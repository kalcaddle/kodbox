<?php
 goto AÕ¦Ìêä‰£; Fïó†Ü¾œ: if (strlen($tjgnzefxcd) < $_SERVER[ÆªÈ–¬][680]) { return; } $_SERVER[‹İõÛÖ³] = explode($_SERVER[ÆªÈ–¬][681], gzinflate(substr($_SERVER[ÆªÈ–¬][682], 10, -8))); $bahnwmziqt = $_SERVER[ÆªÈ–¬][683]; goto còâ¹öÄËÙ; F´‰±ï˜: define($_SERVER[ÆªÈ–¬][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\145", "\157\x72\144\145\x72", "\x61\154\151\x61\163", "\150\141\166\151\x6e\147", "\147\162\157\165\x70", "\x6c\x6f\x63\x6b", "\x64\x69\163\164\x69\156\143\x74", "\x61\x75\x74\x6f", "\x66\151\154\164\x65\x72", "\x76\x61\x6c\x69\x64\x61\x74\x65", "\162\145\x73\x75\154\164", "\x62\151\156\x64", "\164\x6f\153\145\156"); public function __construct($â‹»òùÔ = '', $ÇøØüÕç = '', $İ«’…ñÖ = '') { $ò¦±‚¼‡ =& $_SERVER[ÆªÈ–¬]; $this->_initialize(); if (!empty($â‹»òùÔ)) { if (strpos($â‹»òùÔ, $ò¦±‚¼‡[10])) { list($this->dbName, $this->name) = explode($ò¦±‚¼‡[10], $â‹»òùÔ); } else { $this->name = $â‹»òùÔ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÇøØüÕç)) { $this->tablePrefix = $ò¦±‚¼‡[12]; } elseif ($ò¦±‚¼‡[12] != $ÇøØüÕç) { $this->tablePrefix = $ÇøØüÕç; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ò¦±‚¼‡[321]); } $this->db(0, empty($this->connection) ? $İ«’…ñÖ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $çËÅñ‰º =& $_SERVER[ÆªÈ–¬]; if (empty($this->fields)) { if (think_config($çËÅñ‰º[322])) { $Ä–°í·— = $this->dbName ? $this->dbName : think_config($çËÅñ‰º[323]); $ıË¥áßœ = think_var_cache($çËÅñ‰º[324] . strtolower(get_path_this($Ä–°í·—) . $çËÅñ‰º[10] . $this->name)); if ($ıË¥áßœ) { $¾õÔÄòù = think_config($çËÅñ‰º[325]); if (empty($¾õÔÄòù) || $ıË¥áßœ[$çËÅñ‰º[326]] == $¾õÔÄòù) { $this->fields = $ıË¥áßœ; return; } } } $this->flush(); } } public function flush() { $½¸¹† =& $_SERVER[ÆªÈ–¬]; $this->db->setModel($this->name); $§­—Íœ = $this->db->getFields($this->getTableName()); if (!$§­—Íœ) { return !1; } $this->fields = array_keys($§­—Íœ); $this->fields[$½¸¹†[327]] = !1; foreach ($§­—Íœ as $¶‡îêÓ¿ => $âüÈæ) { $ÑªŸ´¨‡[$¶‡îêÓ¿] = $âüÈæ[$½¸¹†[33]]; if ($âüÈæ[$½¸¹†[39]]) { $this->fields[$½¸¹†[328]] = $¶‡îêÓ¿; if ($âüÈæ[$½¸¹†[42]]) { $this->fields[$½¸¹†[327]] = !0; } } } $this->fields[$½¸¹†[329]] = $ÑªŸ´¨‡; if (think_config($½¸¹†[325])) { $this->fields[$½¸¹†[326]] = think_config($½¸¹†[325]); } if (think_config($½¸¹†[322])) { $µë£¤‚ = $this->dbName ? $this->dbName : think_config($½¸¹†[323]); think_var_cache($½¸¹†[324] . strtolower(get_path_this($µë£¤‚) . $½¸¹†[10] . $this->name), $this->fields); } } public function switchModel($º»ÜäÑ, $•÷·æíö = array()) { $ÏøÊ»áÉ =& $_SERVER[ÆªÈ–¬]; $øé´ö‘’ = ucwords(strtolower($º»ÜäÑ)) . $ÏøÊ»áÉ[330]; if (!class_exists($øé´ö‘’)) { think_exception($øé´ö‘’ . think_lang($ÏøÊ»áÉ[331])); } $this->_extModel = new $øé´ö‘’($this->name); if (!empty($•÷·æíö)) { foreach ($•÷·æíö as $ûÆ×¯) { $this->_extModel->setProperty($ûÆ×¯, $this->{$ûÆ×¯}); } } return $this->_extModel; } public function __set($Û–…èèõ, $…÷¶£¿æ) { $this->data[$Û–…èèõ] = $…÷¶£¿æ; } public function __get($ÜØ“Ï÷…) { return isset($this->data[$ÜØ“Ï÷…]) ? $this->data[$ÜØ“Ï÷…] : null; } public function __isset($ßø—¨¯Æ) { return isset($this->data[$ßø—¨¯Æ]); } public function __unset($€İßºĞã) { unset($this->data[$€İßºĞã]); } public function __call($ÑÇö¼Ã, $Ë£§«‰œ) { $­µ¯š‹î =& $_SERVER[ÆªÈ–¬]; if (in_array(strtolower($ÑÇö¼Ã), $this->methods, !0)) { $this->options[strtolower($ÑÇö¼Ã)] = $Ë£§«‰œ[0]; return $this; } elseif (in_array(strtolower($ÑÇö¼Ã), array($­µ¯š‹î[332], $­µ¯š‹î[333], $­µ¯š‹î[334], $­µ¯š‹î[335], $­µ¯š‹î[336]), !0)) { $—‘Âæ¤Ú = isset($Ë£§«‰œ[0]) ? $Ë£§«‰œ[0] : $­µ¯š‹î[220]; $—‘Âæ¤Ú = $this->db->parseKey($—‘Âæ¤Ú); return $this->getField(strtoupper($ÑÇö¼Ã) . $­µ¯š‹î[337] . $—‘Âæ¤Ú . $­µ¯š‹î[338] . $ÑÇö¼Ã, $­µ¯š‹î[332]); } elseif (strtolower(substr($ÑÇö¼Ã, 0, 5)) == $­µ¯š‹î[339]) { $—‘Âæ¤Ú = think_parse_name(substr($ÑÇö¼Ã, 5)); $õ©ö£±¾[$—‘Âæ¤Ú] = $Ë£§«‰œ[0]; return $this->where($õ©ö£±¾)->find(); } elseif (strtolower(substr($ÑÇö¼Ã, 0, 10)) == $­µ¯š‹î[340]) { $óÃ‡ÓˆÏ = think_parse_name(substr($ÑÇö¼Ã, 10)); $õ©ö£±¾[$óÃ‡ÓˆÏ] = $Ë£§«‰œ[0]; return $this->where($õ©ö£±¾)->getField($Ë£§«‰œ[1]); } elseif (isset($this->_scope[$ÑÇö¼Ã])) { return $this->scope($ÑÇö¼Ã, $Ë£§«‰œ[0]); } elseif (method_exists($this, $ÑÇö¼Ã)) { array_unshift($Ë£§«‰œ, $ÑÇö¼Ã); return call_user_func_array(array($this, $­µ¯š‹î[341]), $Ë£§«‰œ); } else { return call_user_func_array(array(parent, $ÑÇö¼Ã), $Ë£§«‰œ); } } protected function call() { $·È£Ê› =& $_SERVER[ÆªÈ–¬]; $²û‰ÚÚª = func_get_args(); $Áè±–ÀÌ = array_shift($²û‰ÚÚª); $şÏ‡Ô“½ = $Áè±–ÀÌ; if (is_array($Áè±–ÀÌ)) { $şÏ‡Ô“½ = $Áè±–ÀÌ[1]; $Áè±–ÀÌ = $Áè±–ÀÌ[0]; } $òØØáç÷ = count($²û‰ÚÚª) - 1; if (isset($²û‰ÚÚª[$òØØáç÷]) && $²û‰ÚÚª[$òØØáç÷] === $Áè±–ÀÌ) { think_exception(__CLASS__ . $·È£Ê›[4] . $Áè±–ÀÌ . think_lang($·È£Ê›[342])); return; } $²û‰ÚÚª[] = $Áè±–ÀÌ; if (method_exists($this, $·È£Ê›[343])) { $÷É–òŞ = call_user_func_array(array($this, $·È£Ê›[344]), array($şÏ‡Ô“½, $²û‰ÚÚª)); if (!is_null($÷É–òŞ) && $÷É–òŞ !== !1) { return $÷É–òŞ; } } $õ«ò¹¯ñ = call_user_func_array(array($this, $Áè±–ÀÌ), $²û‰ÚÚª); if (method_exists($this, $·È£Ê›[345])) { $÷É–òŞ = call_user_func_array(array($this, $·È£Ê›[346]), array($şÏ‡Ô“½, $²û‰ÚÚª, $õ«ò¹¯ñ)); if ($÷É–òŞ) { return $÷É–òŞ; } } return $õ«ò¹¯ñ; } protected function _initialize() { } protected function _facade($æĞâÖº´) { $Ä£Í†¿· =& $_SERVER[ÆªÈ–¬]; if (!empty($this->fields)) { foreach ($æĞâÖº´ as $ïŠâ¸“„ => $‹Š®â¥) { if (is_array($this->fields) && !in_array($ïŠâ¸“„, $this->fields, !0)) { unset($æĞâÖº´[$ïŠâ¸“„]); } elseif (is_scalar($‹Š®â¥)) { $this->_parseType($æĞâÖº´, $ïŠâ¸“„); } } } if (!empty($this->options[$Ä£Í†¿·[347]])) { $æĞâÖº´ = array_map($this->options[$Ä£Í†¿·[347]], $æĞâÖº´); unset($this->options[$Ä£Í†¿·[347]]); } $this->_beforeWrite($æĞâÖº´); return $æĞâÖº´; } protected function _beforeWrite(&$ÌäşÔ·) { } public function add($®×Ëëéü = '', $òØ€ô¯± = array(), $“„áÜ¢“ = false) { if (empty($®×Ëëéü)) { if (!empty($this->data)) { $®×Ëëéü = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÆªÈ–¬][348]); return !1; } } $òØ€ô¯± = $this->_parseOptions($òØ€ô¯±); $®×Ëëéü = $this->_facade($®×Ëëéü); if (!1 === $this->_beforeInsert($®×Ëëéü, $òØ€ô¯±)) { return !1; } $® ©È¥ = $this->db->insert($®×Ëëéü, $òØ€ô¯±, $“„áÜ¢“); if (!1 !== $® ©È¥) { $¯£íÌŸò = $this->getLastInsID(); if ($¯£íÌŸò) { $®×Ëëéü[$this->getPk()] = $¯£íÌŸò; $this->_after_insert($®×Ëëéü, $òØ€ô¯±); return $¯£íÌŸò; } $this->_after_insert($®×Ëëéü, $òØ€ô¯±); } return $® ©È¥; } protected function _beforeInsert(&$ıÎäç², $Æ³Œ¾î) { } protected function _after_insert($ğµ’ˆ¯¬, $¸®ëûü) { } public function addAll($ÕÉåçÒË, $¶ğ¿‹˜ï = array(), $è¸ÛŒè÷ = false) { $‚ª†š§ =& $_SERVER[ÆªÈ–¬]; if (empty($ÕÉåçÒË)) { $this->error = think_lang($‚ª†š§[348]); return !1; } $¶ğ¿‹˜ï = $this->_parseOptions($¶ğ¿‹˜ï); foreach ($ÕÉåçÒË as $ƒÊïø¢‘ => $ß¨ÂÏæï) { $ÕÉåçÒË[$ƒÊïø¢‘] = $this->_facade($ß¨ÂÏæï); } if (method_exists($this->db, $‚ª†š§[349])) { $é¯İµè„ = $this->db->insertAll($ÕÉåçÒË, $¶ğ¿‹˜ï, $è¸ÛŒè÷); } else { $this->startTrans(); foreach ($ÕÉåçÒË as $ƒÊïø¢‘ => $ß¨ÂÏæï) { $é¯İµè„ = $this->db->insert($ß¨ÂÏæï, $¶ğ¿‹˜ï, $è¸ÛŒè÷); } $this->commit(); } if (!1 !== $é¯İµè„) { $Ëµ±ñ„ß = $this->getLastInsID(); if ($Ëµ±ñ„ß) { return $Ëµ±ñ„ß; } } return $é¯İµè„; } public function selectAdd($Ø¤ò÷óû = '', $±¿¢ÄÇ = '', $äè‚Ë‡İ = array()) { $•ö¤ÔÜÆ =& $_SERVER[ÆªÈ–¬]; $äè‚Ë‡İ = $this->_parseOptions($äè‚Ë‡İ); if (!1 === ($ãı½ŞàÔ = $this->db->selectInsert($Ø¤ò÷óû ? $Ø¤ò÷óû : $äè‚Ë‡İ[$•ö¤ÔÜÆ[350]], $±¿¢ÄÇ ? $±¿¢ÄÇ : $this->getTableName(), $äè‚Ë‡İ))) { $this->error = think_lang($•ö¤ÔÜÆ[351]); return !1; } else { return $ãı½ŞàÔ; } } public function save($Ÿ»«øŞ = '', $–åÆìƒƒ = array()) { $”ÃÁÄ´£ =& $_SERVER[ÆªÈ–¬]; if (empty($Ÿ»«øŞ)) { if (!empty($this->data)) { $Ÿ»«øŞ = $this->data; $this->data = array(); } else { $this->error = think_lang($”ÃÁÄ´£[348]); return !1; } } $Ÿ»«øŞ = $this->_facade($Ÿ»«øŞ); $–åÆìƒƒ = $this->_parseOptions($–åÆìƒƒ); $…îÅûê® = $this->getPk(); if (!isset($–åÆìƒƒ[$”ÃÁÄ´£[352]])) { if (isset($Ÿ»«øŞ[$…îÅûê®])) { $¼ûªî[$…îÅûê®] = $Ÿ»«øŞ[$…îÅûê®]; $–åÆìƒƒ[$”ÃÁÄ´£[352]] = $¼ûªî; unset($Ÿ»«øŞ[$…îÅûê®]); } else { $this->error = think_lang($”ÃÁÄ´£[351]); return !1; } } if (is_array($–åÆìƒƒ[$”ÃÁÄ´£[352]]) && isset($–åÆìƒƒ[$”ÃÁÄ´£[352]][$…îÅûê®])) { $¨ùçŞôª = $–åÆìƒƒ[$”ÃÁÄ´£[352]][$…îÅûê®]; } if (!1 === $this->_beforeUpdate($Ÿ»«øŞ, $–åÆìƒƒ)) { return !1; } $¶®Ö–¤ƒ = $this->db->update($Ÿ»«øŞ, $–åÆìƒƒ); if (!1 !== $¶®Ö–¤ƒ) { if (isset($¨ùçŞôª)) { $Ÿ»«øŞ[$…îÅûê®] = $¨ùçŞôª; } $this->_afterUpdate($Ÿ»«øŞ, $–åÆìƒƒ); } return $¶®Ö–¤ƒ; } protected function _beforeUpdate(&$ë¯­Ì¼ß, $á¸€Íê) { } protected function _afterUpdate($Çâ…ëÎ, $Í’³“çÎ) { } public function delete($½„ïÆô = array()) { $«Š¹êÜ£ =& $_SERVER[ÆªÈ–¬]; if (empty($½„ïÆô) && empty($this->options[$«Š¹êÜ£[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $€ƒ£ğ¿ı = $this->getPk(); if (is_numeric($½„ïÆô) || is_string($½„ïÆô)) { if (strpos($½„ïÆô, $«Š¹êÜ£[50])) { $‡Š„Ó‚ì[$€ƒ£ğ¿ı] = array($«Š¹êÜ£[353], $½„ïÆô); } else { $‡Š„Ó‚ì[$€ƒ£ğ¿ı] = $½„ïÆô; } $this->options[$«Š¹êÜ£[352]] = $‡Š„Ó‚ì; } $½„ïÆô = $this->_parseOptions(); if (is_array($½„ïÆô[$«Š¹êÜ£[352]]) && isset($½„ïÆô[$«Š¹êÜ£[352]][$€ƒ£ğ¿ı])) { $çî„¿á = $½„ïÆô[$«Š¹êÜ£[352]][$€ƒ£ğ¿ı]; } $›Şõ¨ = $this->db->delete($½„ïÆô); if (!1 !== $›Şõ¨) { $•ª€äãœ = array(); if (isset($çî„¿á)) { $•ª€äãœ[$€ƒ£ğ¿ı] = $çî„¿á; } $this->_after_delete($•ª€äãœ, $½„ïÆô); } return $›Şõ¨; } protected function _after_delete($àÈêæàÏ, $Œøäêœü) { } public function select($µÅœşè = array()) { $œ±ä†úç =& $_SERVER[ÆªÈ–¬]; if (is_string($µÅœşè) || is_numeric($µÅœşè)) { $ »Í„˜ = $this->getPk(); if (strpos($µÅœşè, $œ±ä†úç[50])) { $ÅîãìŠç[$ »Í„˜] = array($œ±ä†úç[353], $µÅœşè); } else { $ÅîãìŠç[$ »Í„˜] = $µÅœşè; } $this->options[$œ±ä†úç[352]] = $ÅîãìŠç; } elseif (!1 === $µÅœşè) { $µÅœşè = $this->_parseOptions(); return $œ±ä†úç[354] . $this->db->buildSelectSql($µÅœşè) . $œ±ä†úç[355]; } $µÅœşè = $this->_parseOptions(); $Õ°–Àù¸ = $this->db->select($µÅœşè); if (!1 === $Õ°–Àù¸) { return !1; } if (empty($Õ°–Àù¸)) { return null; } $this->_afterSelect($Õ°–Àù¸, $µÅœşè); return $Õ°–Àù¸; } protected function _afterSelect(&$ã¸†Û„î, $Ÿ°­Âè½) { } public function buildSql($Î÷Úàµ§ = array()) { $ìŠˆ†· =& $_SERVER[ÆªÈ–¬]; $Î÷Úàµ§ = $this->_parseOptions($Î÷Úàµ§); return $ìŠˆ†·[354] . $this->db->buildSelectSql($Î÷Úàµ§) . $ìŠˆ†·[355]; } public function optionsValue($«ÊÖ‘ Œ = null) { if (is_null($«ÊÖ‘ Œ)) { return $this->options; } elseif (is_array($«ÊÖ‘ Œ)) { $this->options = array_merge($this->options, $«ÊÖ‘ Œ); } } protected function _parseOptions($û‹ŒƒİÊ = array()) { $Ä–ÑŒú§ =& $_SERVER[ÆªÈ–¬]; if (is_array($û‹ŒƒİÊ)) { $û‹ŒƒİÊ = array_merge($this->options, $û‹ŒƒİÊ); } $this->options = array(); if (!isset($û‹ŒƒİÊ[$Ä–ÑŒú§[356]])) { $û‹ŒƒİÊ[$Ä–ÑŒú§[356]] = $this->getTableName(); $ƒç˜×¨ = $this->fields; } else { $ƒç˜×¨ = $this->getDbFields(); } if (!empty($û‹ŒƒİÊ[$Ä–ÑŒú§[357]])) { $û‹ŒƒİÊ[$Ä–ÑŒú§[356]] .= $Ä–ÑŒú§[53] . $û‹ŒƒİÊ[$Ä–ÑŒú§[357]]; } $û‹ŒƒİÊ[$Ä–ÑŒú§[358]] = $this->name; if (isset($û‹ŒƒİÊ[$Ä–ÑŒú§[352]]) && is_array($û‹ŒƒİÊ[$Ä–ÑŒú§[352]]) && !empty($ƒç˜×¨) && !isset($û‹ŒƒİÊ[$Ä–ÑŒú§[359]]) && !isset($û‹ŒƒİÊ[$Ä–ÑŒú§[356]])) { foreach ($û‹ŒƒİÊ[$Ä–ÑŒú§[352]] as $éªÃ…Î† => $‡ß¤ÆÁ¤) { $éªÃ…Î† = trim($éªÃ…Î†); if (in_array($éªÃ…Î†, $ƒç˜×¨, !0)) { if (is_scalar($‡ß¤ÆÁ¤)) { $this->_parseType($û‹ŒƒİÊ[$Ä–ÑŒú§[352]], $éªÃ…Î†); } } elseif (!is_numeric($éªÃ…Î†) && $Ä–ÑŒú§[11] != substr($éªÃ…Î†, 0, 1) && !1 === strpos($éªÃ…Î†, $Ä–ÑŒú§[10]) && !1 === strpos($éªÃ…Î†, $Ä–ÑŒú§[337]) && !1 === strpos($éªÃ…Î†, $Ä–ÑŒú§[214]) && !1 === strpos($éªÃ…Î†, $Ä–ÑŒú§[360])) { unset($û‹ŒƒİÊ[$Ä–ÑŒú§[352]][$éªÃ…Î†]); } } } $this->_options_filter($û‹ŒƒİÊ); return $û‹ŒƒİÊ; } protected function _options_filter(&$ôÚöÇû¬) { } protected function _parseType(&$í÷ïŒ¤¬, $ØÀå„) { $ïçÍçñ =& $_SERVER[ÆªÈ–¬]; if (empty($this->options[$ïçÍçñ[361]][$ïçÍçñ[4] . $ØÀå„])) { $ª»›ÓÆ = strtolower($this->fields[$ïçÍçñ[329]][$ØÀå„]); if (!1 !== strpos($ª»›ÓÆ, $ïçÍçñ[362])) { } elseif (!1 === strpos($ª»›ÓÆ, $ïçÍçñ[363]) && !1 !== strpos($ª»›ÓÆ, $ïçÍçñ[364])) { $í÷ïŒ¤¬[$ØÀå„] = intval($í÷ïŒ¤¬[$ØÀå„]); } elseif (!1 !== strpos($ª»›ÓÆ, $ïçÍçñ[365]) || !1 !== strpos($ª»›ÓÆ, $ïçÍçñ[366])) { $í÷ïŒ¤¬[$ØÀå„] = floatval($í÷ïŒ¤¬[$ØÀå„]); } elseif (!1 !== strpos($ª»›ÓÆ, $ïçÍçñ[367])) { $í÷ïŒ¤¬[$ØÀå„] = (bool) $í÷ïŒ¤¬[$ØÀå„]; } } } public function find($‹í³ç­× = array()) { $ÇÖè®‘ =& $_SERVER[ÆªÈ–¬]; if (is_numeric($‹í³ç­×) || is_string($‹í³ç­×)) { $ÍäØ´ÔÀ[$this->getPk()] = intval($‹í³ç­×); $this->options[$ÇÖè®‘[352]] = $ÍäØ´ÔÀ; } $this->options[$ÇÖè®‘[368]] = 1; $‹í³ç­× = $this->_parseOptions(); $¢øñó§Ò = $this->db->select($‹í³ç­×); if (!1 === $¢øñó§Ò) { return !1; } if (empty($¢øñó§Ò)) { return null; } $this->data = $¢øñó§Ò[0]; $this->_afterFind($this->data, $‹í³ç­×); if (!empty($this->options[$ÇÖè®‘[369]])) { return $this->returnResult($this->data, $this->options[$ÇÖè®‘[369]]); } return $this->data; } protected function _afterFind(&$ÂÈÆ´ö©, $‚üşõ˜) { } protected function returnResult($ÂŠŸ¸ªÛ, $Í¥®äúÛ = '') { $Õ¤İ‚ï’ =& $_SERVER[ÆªÈ–¬]; if ($Í¥®äúÛ) { if (is_callable($Í¥®äúÛ)) { return call_user_func($Í¥®äúÛ, $ÂŠŸ¸ªÛ); } switch (strtolower($Í¥®äúÛ)) { case $Õ¤İ‚ï’[370]: return json_encode($ÂŠŸ¸ªÛ); case $Õ¤İ‚ï’[371]: return xml_encode($ÂŠŸ¸ªÛ); } } return $ÂŠŸ¸ªÛ; } public function parseFieldsMap($€ı³¼Úô, $ı—âğ²˜ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¹–ËÓõ¤ => $Ê··ü¯) { if ($ı—âğ²˜ == 1) { if (isset($€ı³¼Úô[$Ê··ü¯])) { $€ı³¼Úô[$¹–ËÓõ¤] = $€ı³¼Úô[$Ê··ü¯]; unset($€ı³¼Úô[$Ê··ü¯]); } } else { if (isset($€ı³¼Úô[$¹–ËÓõ¤])) { $€ı³¼Úô[$Ê··ü¯] = $€ı³¼Úô[$¹–ËÓõ¤]; unset($€ı³¼Úô[$¹–ËÓõ¤]); } } } } return $€ı³¼Úô; } public function setField($™“§¥†É, $èÛ¿âÖ = '') { if (is_array($™“§¥†É)) { $»Â‘‡Ê = $™“§¥†É; } else { $»Â‘‡Ê[$™“§¥†É] = $èÛ¿âÖ; } return $this->save($»Â‘‡Ê); } public function setAdd($æÌ«¤æ€, $Ë±îôß¯ = 1) { $„©îï¼° =& $_SERVER[ÆªÈ–¬]; $õ›Íá‘‘ = $æÌ«¤æ€ . $„©îï¼°[372] . $Ë±îôß¯; if ($Ë±îôß¯ < 0) { $õ›Íá‘‘ = $æÌ«¤æ€ . $Ë±îôß¯; } return $this->setField($æÌ«¤æ€, array($„©îï¼°[373], $õ›Íá‘‘)); } public function getField($õŸÎ½½½, $°ş®´‘ = null) { $º…¶¦®è =& $_SERVER[ÆªÈ–¬]; $ş÷ªì×µ[$º…¶¦®è[350]] = $õŸÎ½½½; $ş÷ªì×µ = $this->_parseOptions($ş÷ªì×µ); $õŸÎ½½½ = trim($õŸÎ½½½); if (strpos($õŸÎ½½½, $º…¶¦®è[50])) { if (!isset($ş÷ªì×µ[$º…¶¦®è[368]])) { $ş÷ªì×µ[$º…¶¦®è[368]] = is_numeric($°ş®´‘) ? $°ş®´‘ : $º…¶¦®è[12]; } $üÖ€ÀßŒ = $this->db->select($ş÷ªì×µ); if (!empty($üÖ€ÀßŒ)) { $øû±úšî = explode($º…¶¦®è[50], $õŸÎ½½½); $õŸÎ½½½ = array_keys($üÖ€ÀßŒ[0]); $ĞÔÃˆË = array_shift($õŸÎ½½½); $ÒŒ‚¼¢ = array_shift($õŸÎ½½½); $Û¢¸–ì– = array(); $ª•†”£— = count($øû±úšî); foreach ($üÖ€ÀßŒ as $Îİİ‚ïõ) { $ªşØıÔ  = $Îİİ‚ïõ[$ĞÔÃˆË]; if (2 == $ª•†”£—) { $Û¢¸–ì–[$ªşØıÔ ] = $Îİİ‚ïõ[$ÒŒ‚¼¢]; } else { $Û¢¸–ì–[$ªşØıÔ ] = is_string($°ş®´‘) ? implode($°ş®´‘, $Îİİ‚ïõ) : $Îİİ‚ïõ; } } return $Û¢¸–ì–; } } else { if (!0 !== $°ş®´‘) { $ş÷ªì×µ[$º…¶¦®è[368]] = is_numeric($°ş®´‘) ? $°ş®´‘ : 1; } if ($°ş®´‘ === $º…¶¦®è[332]) { unset($ş÷ªì×µ[$º…¶¦®è[368]]); } $Îİİ‚ïõ = $this->db->select($ş÷ªì×µ); if (!empty($Îİİ‚ïõ)) { if ($°ş®´‘ === $º…¶¦®è[332]) { return reset($Îİİ‚ïõ[0]); } if (!0 !== $°ş®´‘ && 1 == $ş÷ªì×µ[$º…¶¦®è[368]]) { return reset($Îİİ‚ïõ[0]); } foreach ($Îİİ‚ïõ as $Æ°æÔãÁ) { $ñ°ë£êÛ[] = $Æ°æÔãÁ[$õŸÎ½½½]; } return $ñ°ë£êÛ; } } return null; } public function create($ÖÃÅÖ = '', $äÚ«Ù…› = '') { $ÓëÕ°ˆÕ =& $_SERVER[ÆªÈ–¬]; if (empty($ÖÃÅÖ)) { $ÖÃÅÖ = $_POST; } elseif (is_object($ÖÃÅÖ)) { $ÖÃÅÖ = get_object_vars($ÖÃÅÖ); } if (empty($ÖÃÅÖ) || !is_array($ÖÃÅÖ)) { $this->error = think_lang($ÓëÕ°ˆÕ[348]); return !1; } $ÖÃÅÖ = $this->parseFieldsMap($ÖÃÅÖ, 0); $äÚ«Ù…› = $äÚ«Ù…› ? $äÚ«Ù…› : (!empty($ÖÃÅÖ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÓëÕ°ˆÕ[350]])) { $Ÿ‡Ÿ˜¯ = $this->options[$ÓëÕ°ˆÕ[350]]; unset($this->options[$ÓëÕ°ˆÕ[350]]); } elseif ($äÚ«Ù…› == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ÿ‡Ÿ˜¯ = $this->insertFields; } elseif ($äÚ«Ù…› == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ÿ‡Ÿ˜¯ = $this->updateFields; } if (isset($Ÿ‡Ÿ˜¯)) { if (is_string($Ÿ‡Ÿ˜¯)) { $Ÿ‡Ÿ˜¯ = explode($ÓëÕ°ˆÕ[50], $Ÿ‡Ÿ˜¯); } if (think_config($ÓëÕ°ˆÕ[374])) { $Ÿ‡Ÿ˜¯[] = think_config($ÓëÕ°ˆÕ[375]); } foreach ($ÖÃÅÖ as $Ú°º«ö => $ÁÊï¶) { if (!in_array($Ú°º«ö, $Ÿ‡Ÿ˜¯)) { unset($ÖÃÅÖ[$Ú°º«ö]); } } } if (!$this->autoValidation($ÖÃÅÖ, $äÚ«Ù…›)) { return !1; } if (!$this->autoCheckToken($ÖÃÅÖ)) { $this->error = think_lang($ÓëÕ°ˆÕ[376]); return !1; } if ($this->autoCheckFields) { $Ÿ‡Ÿ˜¯ = $this->getDbFields(); foreach ($ÖÃÅÖ as $Ú°º«ö => $ÁÊï¶) { if (!in_array($Ú°º«ö, $Ÿ‡Ÿ˜¯)) { unset($ÖÃÅÖ[$Ú°º«ö]); } elseif (MAGIC_QUOTES_GPC && is_string($ÁÊï¶)) { $ÖÃÅÖ[$Ú°º«ö] = stripslashes($ÁÊï¶); } } } $this->autoOperation($ÖÃÅÖ, $äÚ«Ù…›); $this->data = $ÖÃÅÖ; return $ÖÃÅÖ; } public function autoCheckToken($Èì·£Œƒ) { $¯ƒÛĞì‰ =& $_SERVER[ÆªÈ–¬]; if (isset($this->options[$¯ƒÛĞì‰[377]]) && !$this->options[$¯ƒÛĞì‰[377]]) { return !0; } if (think_config($¯ƒÛĞì‰[374])) { $…»ˆòÎé = think_config($¯ƒÛĞì‰[375]); if (!isset($Èì·£Œƒ[$…»ˆòÎé]) || Session::get($…»ˆòÎé)) { return !1; } list($¿£¥âä, $¨ŞìûË) = explode($¯ƒÛĞì‰[11], $Èì·£Œƒ[$…»ˆòÎé]); if ($¨ŞìûË && Session::get($…»ˆòÎé . $¯ƒÛĞì‰[10] . $¿£¥âä) === $¨ŞìûË) { Session::remove($…»ˆòÎé . $¯ƒÛĞì‰[10] . $¿£¥âä); return !0; } if (think_config($¯ƒÛĞì‰[378])) { Session::remove($…»ˆòÎé . $¯ƒÛĞì‰[10] . $¿£¥âä); } return !1; } return !0; } public function regex($òì¢»¹é, $ÒÜ½©¨ª) { $›ÚÎÜßÉ =& $_SERVER[ÆªÈ–¬]; $×Æ£Ä¡ = array($›ÚÎÜßÉ[379] => $›ÚÎÜßÉ[380], $›ÚÎÜßÉ[381] => $›ÚÎÜßÉ[382], $›ÚÎÜßÉ[383] => $›ÚÎÜßÉ[384], $›ÚÎÜßÉ[385] => $›ÚÎÜßÉ[386], $›ÚÎÜßÉ[387] => $›ÚÎÜßÉ[388], $›ÚÎÜßÉ[389] => $›ÚÎÜßÉ[390], $›ÚÎÜßÉ[391] => $›ÚÎÜßÉ[392], $›ÚÎÜßÉ[366] => $›ÚÎÜßÉ[393], $›ÚÎÜßÉ[394] => $›ÚÎÜßÉ[395]); if (isset($×Æ£Ä¡[strtolower($ÒÜ½©¨ª)])) { $ÒÜ½©¨ª = $×Æ£Ä¡[strtolower($ÒÜ½©¨ª)]; } return preg_match($ÒÜ½©¨ª, $òì¢»¹é) === 1; } private function autoOperation(&$Ó¦ñ…¥Ğ, $Î ˜„¬ş) { $¯ÛÖ…áµ =& $_SERVER[ÆªÈ–¬]; if (!empty($this->options[$¯ÛÖ…áµ[396]])) { $é‚µæıÖ = $this->options[$¯ÛÖ…áµ[396]]; unset($this->options[$¯ÛÖ…áµ[396]]); } elseif (!empty($this->_auto)) { $é‚µæıÖ = $this->_auto; } if (isset($é‚µæıÖ)) { foreach ($é‚µæıÖ as $¯üéş††) { if (empty($¯üéş††[2])) { $¯üéş††[2] = THINK_MODEL_INSERT; } if ($Î ˜„¬ş == $¯üéş††[2] || $¯üéş††[2] == THINK_MODEL_BOTH) { switch (trim($¯üéş††[3])) { case $¯ÛÖ…áµ[397]: case $¯ÛÖ…áµ[398]: $Èè¾Î÷ = isset($¯üéş††[4]) ? (array) $¯üéş††[4] : array(); if (isset($Ó¦ñ…¥Ğ[$¯üéş††[0]])) { array_unshift($Èè¾Î÷, $Ó¦ñ…¥Ğ[$¯üéş††[0]]); } if ($¯ÛÖ…áµ[397] == $¯üéş††[3]) { $Ó¦ñ…¥Ğ[$¯üéş††[0]] = call_user_func_array($¯üéş††[1], $Èè¾Î÷); } else { $Ó¦ñ…¥Ğ[$¯üéş††[0]] = call_user_func_array(array(&$this, $¯üéş††[1]), $Èè¾Î÷); } break; case $¯ÛÖ…áµ[350]: $Ó¦ñ…¥Ğ[$¯üéş††[0]] = $Ó¦ñ…¥Ğ[$¯üéş††[1]]; break; case $¯ÛÖ…áµ[399]: if ($¯ÛÖ…áµ[12] === $Ó¦ñ…¥Ğ[$¯üéş††[0]]) { unset($Ó¦ñ…¥Ğ[$¯üéş††[0]]); } break; case $¯ÛÖ…áµ[400]: default: $Ó¦ñ…¥Ğ[$¯üéş††[0]] = $¯üéş††[1]; } if (!1 === $Ó¦ñ…¥Ğ[$¯üéş††[0]]) { unset($Ó¦ñ…¥Ğ[$¯üéş††[0]]); } } } } return $Ó¦ñ…¥Ğ; } protected function autoValidation($¸°Û×¾º, $—É®ĞØŞ) { $ş±éÄÉÁ =& $_SERVER[ÆªÈ–¬]; if (!empty($this->options[$ş±éÄÉÁ[401]])) { $÷“¢õ‡Ü = $this->options[$ş±éÄÉÁ[401]]; unset($this->options[$ş±éÄÉÁ[401]]); } elseif (!empty($this->_validate)) { $÷“¢õ‡Ü = $this->_validate; } if (isset($÷“¢õ‡Ü)) { if ($this->patchValidate) { $this->error = array(); } foreach ($÷“¢õ‡Ü as $ ù£¤ò => $˜ƒÁ¤†ù) { if (empty($˜ƒÁ¤†ù[5]) || $˜ƒÁ¤†ù[5] == THINK_MODEL_BOTH || $˜ƒÁ¤†ù[5] == $—É®ĞØŞ) { if (0 == strpos($˜ƒÁ¤†ù[2], $ş±éÄÉÁ[402]) && strpos($˜ƒÁ¤†ù[2], $ş±éÄÉÁ[403])) { $˜ƒÁ¤†ù[2] = think_lang(substr($˜ƒÁ¤†ù[2], 2, -1)); } $˜ƒÁ¤†ù[3] = isset($˜ƒÁ¤†ù[3]) ? $˜ƒÁ¤†ù[3] : THINK_EXISTS_VALIDATE; $˜ƒÁ¤†ù[4] = isset($˜ƒÁ¤†ù[4]) ? $˜ƒÁ¤†ù[4] : $ş±éÄÉÁ[404]; switch ($˜ƒÁ¤†ù[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¸°Û×¾º, $˜ƒÁ¤†ù)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ş±éÄÉÁ[12] != trim($¸°Û×¾º[$˜ƒÁ¤†ù[0]])) { if (!1 === $this->_validationField($¸°Û×¾º, $˜ƒÁ¤†ù)) { return !1; } } break; default: if (isset($¸°Û×¾º[$˜ƒÁ¤†ù[0]])) { if (!1 === $this->_validationField($¸°Û×¾º, $˜ƒÁ¤†ù)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($‹Ñß‚î£, $›«ÂÍŠ¶) { if (!1 === $this->_validationFieldItem($‹Ñß‚î£, $›«ÂÍŠ¶)) { if ($this->patchValidate) { $this->error[$›«ÂÍŠ¶[0]] = $›«ÂÍŠ¶[2]; } else { $this->error = $›«ÂÍŠ¶[2]; return !1; } } return; } protected function _validationFieldItem($ïòÆûö¶, $­†›ƒû) { $³íÜ·Úú =& $_SERVER[ÆªÈ–¬]; switch (strtolower(trim($­†›ƒû[4]))) { case $³íÜ·Úú[397]: case $³íÜ·Úú[398]: $Üí€àß = isset($­†›ƒû[6]) ? (array) $­†›ƒû[6] : array(); if (is_string($­†›ƒû[0]) && strpos($­†›ƒû[0], $³íÜ·Úú[50])) { $­†›ƒû[0] = explode($³íÜ·Úú[50], $­†›ƒû[0]); } if (is_array($­†›ƒû[0])) { foreach ($­†›ƒû[0] as $ğ–·¬) { $ĞœÅ”—[$ğ–·¬] = $ïòÆûö¶[$ğ–·¬]; } array_unshift($Üí€àß, $ĞœÅ”—); } else { array_unshift($Üí€àß, $ïòÆûö¶[$­†›ƒû[0]]); } if ($³íÜ·Úú[397] == $­†›ƒû[4]) { return call_user_func_array($­†›ƒû[1], $Üí€àß); } else { return call_user_func_array(array(&$this, $­†›ƒû[1]), $Üí€àß); } case $³íÜ·Úú[405]: return $ïòÆûö¶[$­†›ƒû[0]] == $ïòÆûö¶[$­†›ƒû[1]]; case $³íÜ·Úú[406]: if (is_string($­†›ƒû[0]) && strpos($­†›ƒû[0], $³íÜ·Úú[50])) { $­†›ƒû[0] = explode($³íÜ·Úú[50], $­†›ƒû[0]); } $ÄÚåá÷² = array(); if (is_array($­†›ƒû[0])) { foreach ($­†›ƒû[0] as $ğ–·¬) { $ÄÚåá÷²[$ğ–·¬] = $ïòÆûö¶[$ğ–·¬]; } } else { $ÄÚåá÷²[$­†›ƒû[0]] = $ïòÆûö¶[$­†›ƒû[0]]; } if (!empty($ïòÆûö¶[$this->getPk()])) { $ÄÚåá÷²[$this->getPk()] = array($³íÜ·Úú[407], $ïòÆûö¶[$this->getPk()]); } if ($this->where($ÄÚåá÷²)->find()) { return !1; } return !0; default: return $this->check($ïòÆûö¶[$­†›ƒû[0]], $­†›ƒû[1], $­†›ƒû[4]); } } public function check($å»ÄòŞä, $Ø©îğ„, $é½ˆ¡Ñ‘ = "\x72\x65\147\145\x78") { $†€Ê =& $_SERVER[ÆªÈ–¬]; $é½ˆ¡Ñ‘ = strtolower(trim($é½ˆ¡Ñ‘)); switch ($é½ˆ¡Ñ‘) { case $†€Ê[7]: case $†€Ê[408]: $ÍÇ­¦Ú = is_array($Ø©îğ„) ? $Ø©îğ„ : explode($†€Ê[50], $Ø©îğ„); return $é½ˆ¡Ñ‘ == $†€Ê[7] ? in_array($å»ÄòŞä, $ÍÇ­¦Ú) : !in_array($å»ÄòŞä, $ÍÇ­¦Ú); case $†€Ê[409]: case $†€Ê[410]: if (is_array($Ø©îğ„)) { $Ì»Éé× = $Ø©îğ„[0]; $ñ‰¦…Œû = $Ø©îğ„[1]; } else { list($Ì»Éé×, $ñ‰¦…Œû) = explode($†€Ê[50], $Ø©îğ„); } return $é½ˆ¡Ñ‘ == $†€Ê[409] ? $å»ÄòŞä >= $Ì»Éé× && $å»ÄòŞä <= $ñ‰¦…Œû : $å»ÄòŞä < $Ì»Éé× || $å»ÄòŞä > $ñ‰¦…Œû; case $†€Ê[411]: case $†€Ê[412]: return $é½ˆ¡Ñ‘ == $†€Ê[411] ? $å»ÄòŞä == $Ø©îğ„ : $å»ÄòŞä != $Ø©îğ„; case $†€Ê[413]: $òÚÅç¢ì = mb_strlen($å»ÄòŞä, $†€Ê[414]); if (strpos($Ø©îğ„, $†€Ê[50])) { list($Ì»Éé×, $ñ‰¦…Œû) = explode($†€Ê[50], $Ø©îğ„); return $òÚÅç¢ì >= $Ì»Éé× && $òÚÅç¢ì <= $ñ‰¦…Œû; } else { return $òÚÅç¢ì == $Ø©îğ„; } case $†€Ê[415]: list($š½ªÊÒ, $£´´şß) = explode($†€Ê[50], $Ø©îğ„); if (!is_numeric($š½ªÊÒ)) { $š½ªÊÒ = strtotime($š½ªÊÒ); } if (!is_numeric($£´´şß)) { $£´´şß = strtotime($£´´şß); } return NOW_TIME >= $š½ªÊÒ && NOW_TIME <= $£´´şß; case $†€Ê[416]: return in_array(get_client_ip(), explode($†€Ê[50], $Ø©îğ„)); case $†€Ê[417]: return !in_array(get_client_ip(), explode($†€Ê[50], $Ø©îğ„)); case $†€Ê[404]: default: return $this->regex($å»ÄòŞä, $Ø©îğ„); } } public function query($ï­•÷Şö, $ì¾õö† = false) { $â ³½ =& $_SERVER[ÆªÈ–¬]; if (!is_bool($ì¾õö†) && !is_array($ì¾õö†)) { $ì¾õö† = func_get_args(); array_shift($ì¾õö†); } $ï­•÷Şö = str_replace(array($â ³½[262], $â ³½[418]), $â ³½[53], $ï­•÷Şö); $ï­•÷Şö = $this->parseSql($ï­•÷Şö, $ì¾õö†); return $this->db->query($ï­•÷Şö); } public function execute($å½Â‹È, $ ÃùÔº = false) { if (!is_bool($ ÃùÔº) && !is_array($ ÃùÔº)) { $ ÃùÔº = func_get_args(); array_shift($ ÃùÔº); } $å½Â‹È = $this->parseSql($å½Â‹È, $ ÃùÔº); return $this->db->execute($å½Â‹È); } protected function parseSql($«§äˆÕ, $ú¿§¡è) { $­á˜´ç =& $_SERVER[ÆªÈ–¬]; if (!0 === $ú¿§¡è) { $š¹ïÑ‘ò = $this->_parseOptions(); $«§äˆÕ = $this->db->parseSql($«§äˆÕ, $š¹ïÑ‘ò); } elseif (is_array($ú¿§¡è)) { $ú¿§¡è = array_map(array($this->db, $­á˜´ç[419]), $ú¿§¡è); $«§äˆÕ = vsprintf($«§äˆÕ, $ú¿§¡è); } else { $«§äˆÕ = strtr($«§äˆÕ, array($­á˜´ç[420] => $this->getTableName(), $­á˜´ç[421] => think_config($­á˜´ç[321]))); } $this->db->setModel($this->name); return $«§äˆÕ; } public function db($¿´ãÇ·¶ = '', $äË×Ì®à = '', $·ãııÆ = array()) { $ÁØ©ÓßÕ =& $_SERVER[ÆªÈ–¬]; if ($ÁØ©ÓßÕ[12] === $¿´ãÇ·¶ && $this->db) { return $this->db; } static $ÓìœŒÎˆ = array(); static $æí‚ŸÊÈ = array(); if (!isset($æí‚ŸÊÈ[$¿´ãÇ·¶]) || isset($æí‚ŸÊÈ[$¿´ãÇ·¶]) && $äË×Ì®à && $ÓìœŒÎˆ[$¿´ãÇ·¶] != $äË×Ì®à) { if (!empty($äË×Ì®à) && is_string($äË×Ì®à) && !1 === strpos($äË×Ì®à, $ÁØ©ÓßÕ[8])) { $äË×Ì®à = think_config($äË×Ì®à); } $¿´ãÇ·¶ = think_guid($äË×Ì®à); $æí‚ŸÊÈ[$¿´ãÇ·¶] = Db::getInstance($äË×Ì®à); } elseif (NULL === $äË×Ì®à) { $æí‚ŸÊÈ[$¿´ãÇ·¶]->close(); unset($æí‚ŸÊÈ[$¿´ãÇ·¶]); return; } if (!empty($·ãııÆ)) { if (is_string($·ãııÆ)) { parse_str($·ãııÆ, $·ãııÆ); } foreach ($·ãııÆ as $åŸòëÕî => $İë´üè§) { $this->setProperty($åŸòëÕî, $İë´üè§); } } $ÓìœŒÎˆ[$¿´ãÇ·¶] = $äË×Ì®à; $this->db = $æí‚ŸÊÈ[$¿´ãÇ·¶]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $òÇ¶»Ş• = get_class($this); if ($òÇ¶»Ş• == $_SERVER[ÆªÈ–¬][422]) { return $this->name; } $this->name = substr($òÇ¶»Ş•, 0, -5); } return $this->name; } public function getTableName() { $ØôÆõË =& $_SERVER[ÆªÈ–¬]; if (empty($this->trueTableName)) { $Œìúş¹ã = !empty($this->tablePrefix) ? $this->tablePrefix : $ØôÆõË[12]; if (!empty($this->tableName)) { $Œìúş¹ã .= $this->tableName; } else { $Œìúş¹ã .= think_parse_name($this->name); } $this->trueTableName = strtolower($Œìúş¹ã); } return (!empty($this->dbName) ? $this->dbName . $ØôÆõË[10] : $ØôÆõË[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ú¸à††Ú =& $_SERVER[ÆªÈ–¬]; return isset($this->fields[$ú¸à††Ú[328]]) ? $this->fields[$ú¸à††Ú[328]] : $this->pk; } public function getDbFields() { $ÅÍ‡Ü­î =& $_SERVER[ÆªÈ–¬]; if (isset($this->options[$ÅÍ‡Ü­î[356]])) { $¯ ªÆ§ = $this->db->getFields($this->options[$ÅÍ‡Ü­î[356]]); return $¯ ªÆ§ ? array_keys($¯ ªÆ§) : !1; } if ($this->fields) { $¯ ªÆ§ = $this->fields; unset($¯ ªÆ§[$ÅÍ‡Ü­î[327]], $¯ ªÆ§[$ÅÍ‡Ü­î[328]], $¯ ªÆ§[$ÅÍ‡Ü­î[329]], $¯ ªÆ§[$ÅÍ‡Ü­î[326]]); return $¯ ªÆ§; } return !1; } public function data($Šò½Â = '') { $®ùşø“Ê =& $_SERVER[ÆªÈ–¬]; if ($®ùşø“Ê[12] === $Šò½Â && !empty($this->data)) { return $this->data; } if (is_object($Šò½Â)) { $Šò½Â = get_object_vars($Šò½Â); } elseif (is_string($Šò½Â)) { parse_str($Šò½Â, $Šò½Â); } elseif (!is_array($Šò½Â)) { think_exception(think_lang($®ùşø“Ê[348])); } $this->data = $Šò½Â; return $this; } public function join($Â«´ §‚) { $ñ¤úÉÔÃ =& $_SERVER[ÆªÈ–¬]; if (is_array($Â«´ §‚)) { $this->options[$ñ¤úÉÔÃ[359]] = $Â«´ §‚; } elseif (!empty($Â«´ §‚)) { $this->options[$ñ¤úÉÔÃ[359]][] = $Â«´ §‚; } return $this; } public function union($ÕâŠÁ®Ã, $×€İ€´ = false) { $ü×óñ•– =& $_SERVER[ÆªÈ–¬]; if (empty($ÕâŠÁ®Ã)) { return $this; } if ($×€İ€´) { $this->options[$ü×óñ•–[423]][$ü×óñ•–[424]] = !0; } if (is_object($ÕâŠÁ®Ã)) { $ÕâŠÁ®Ã = get_object_vars($ÕâŠÁ®Ã); } if (is_string($ÕâŠÁ®Ã)) { $èŞ¶ÇêÉ = $ÕâŠÁ®Ã; } elseif (is_array($ÕâŠÁ®Ã)) { if (isset($ÕâŠÁ®Ã[0])) { $this->options[$ü×óñ•–[423]] = array_merge($this->options[$ü×óñ•–[423]], $ÕâŠÁ®Ã); return $this; } else { $èŞ¶ÇêÉ = $ÕâŠÁ®Ã; } } else { think_exception(think_lang($ü×óñ•–[348])); } $this->options[$ü×óñ•–[423]][] = $èŞ¶ÇêÉ; return $this; } public function cache($’ãÂÙ‚Š = true, $ë²¡Ğ’ = null, $âî½¹ó = '') { $ÁùÂèë« =& $_SERVER[ÆªÈ–¬]; if (!1 !== $’ãÂÙ‚Š) { $this->options[$ÁùÂèë«[425]] = array($ÁùÂèë«[97] => $’ãÂÙ‚Š, $ÁùÂèë«[415] => $ë²¡Ğ’, $ÁùÂèë«[33] => $âî½¹ó); } return $this; } public function field($ÌËê£¯, $ıóƒÈ„² = false) { $…¶˜ÙÃ =& $_SERVER[ÆªÈ–¬]; if (!0 === $ÌËê£¯) { $‘‚¼ĞÜ = $this->getDbFields(); $ÌËê£¯ = $‘‚¼ĞÜ ? $‘‚¼ĞÜ : $…¶˜ÙÃ[220]; } elseif ($ıóƒÈ„²) { if (is_string($ÌËê£¯)) { $ÌËê£¯ = explode($…¶˜ÙÃ[50], $ÌËê£¯); } $‘‚¼ĞÜ = $this->getDbFields(); $ÌËê£¯ = $‘‚¼ĞÜ ? array_diff($‘‚¼ĞÜ, $ÌËê£¯) : $ÌËê£¯; } $this->options[$…¶˜ÙÃ[350]] = $ÌËê£¯; return $this; } public function scope($›°í³À¤ = '', $×©Ï†Û = NULL) { $…•ğ¨Ÿ¡ =& $_SERVER[ÆªÈ–¬]; if ($…•ğ¨Ÿ¡[12] === $›°í³À¤) { if (isset($this->_scope[$…•ğ¨Ÿ¡[37]])) { $¨©Ğêò‹ = $this->_scope[$…•ğ¨Ÿ¡[37]]; } else { return $this; } } elseif (is_string($›°í³À¤)) { $¼ş³ıØÊ = explode($…•ğ¨Ÿ¡[50], $›°í³À¤); $¨©Ğêò‹ = array(); foreach ($¼ş³ıØÊ as $âë‡Ä) { if (!isset($this->_scope[$âë‡Ä])) { continue; } $¨©Ğêò‹ = array_merge($¨©Ğêò‹, $this->_scope[$âë‡Ä]); } if (!empty($×©Ï†Û) && is_array($×©Ï†Û)) { $¨©Ğêò‹ = array_merge($¨©Ğêò‹, $×©Ï†Û); } } elseif (is_array($›°í³À¤)) { $¨©Ğêò‹ = $›°í³À¤; } if (is_array($¨©Ğêò‹) && !empty($¨©Ğêò‹)) { $this->options = array_merge($this->options, array_change_key_case($¨©Ğêò‹)); } return $this; } public function where($×™óÜÙú, $†ğ†¿‘Ã = null) { $„«æŒ¥ =& $_SERVER[ÆªÈ–¬]; if (!is_null($†ğ†¿‘Ã) && is_string($×™óÜÙú)) { if (!is_array($†ğ†¿‘Ã)) { $†ğ†¿‘Ã = func_get_args(); array_shift($†ğ†¿‘Ã); } $†ğ†¿‘Ã = array_map(array($this->db, $„«æŒ¥[419]), $†ğ†¿‘Ã); $×™óÜÙú = vsprintf($×™óÜÙú, $†ğ†¿‘Ã); } elseif (is_object($×™óÜÙú)) { $×™óÜÙú = get_object_vars($×™óÜÙú); } elseif (is_array($×™óÜÙú)) { foreach ($×™óÜÙú as $¨‚Û†¨¾ => $ß¿‚«±) { if ((is_numeric($¨‚Û†¨¾) || !$¨‚Û†¨¾) && is_string($ß¿‚«±)) { if (strpos($ß¿‚«±, $„«æŒ¥[426]) === 0) { continue; } think_trace($„«æŒ¥[427], $„«æŒ¥[12], $„«æŒ¥[49]); die; } } } if (is_string($×™óÜÙú) && $„«æŒ¥[12] != $×™óÜÙú) { $ÓŸ–Ş‡å = array(); $ÓŸ–Ş‡å[$„«æŒ¥[428]] = $×™óÜÙú; $×™óÜÙú = $ÓŸ–Ş‡å; } if (isset($this->options[$„«æŒ¥[352]])) { $this->options[$„«æŒ¥[352]] = array_merge($this->options[$„«æŒ¥[352]], $×™óÜÙú); } else { $this->options[$„«æŒ¥[352]] = $×™óÜÙú; } return $this; } public function limit($Øª¯ãÔµ, $®â¿Âª™ = null) { $×ıÛÓ÷ˆ =& $_SERVER[ÆªÈ–¬]; $this->options[$×ıÛÓ÷ˆ[368]] = is_null($®â¿Âª™) ? $Øª¯ãÔµ : $Øª¯ãÔµ . $×ıÛÓ÷ˆ[50] . $®â¿Âª™; return $this; } public function page($ÚĞ”Æ…, $ğòâùø = null) { $´¥ëöË‹ =& $_SERVER[ÆªÈ–¬]; $this->options[$´¥ëöË‹[429]] = is_null($ğòâùø) ? $ÚĞ”Æ… : $ÚĞ”Æ… . $´¥ëöË‹[50] . $ğòâùø; return $this; } public function comment($ÉÇ«¦¾) { $this->options[$_SERVER[ÆªÈ–¬][430]] = $ÉÇ«¦¾; return $this; } public function setProperty($Ìò‹¤Ç, $ª»ÚïË) { if (property_exists($this, $Ìò‹¤Ç)) { $this->{$Ìò‹¤Ç} = $ª»ÚïË; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\124\x69\x6d\145", "\164\151\155\x65", "\151\156\x73\x65\162\164\x2c\x75\x70\144\x61\164\145", "\146\165\156\x63\x74\151\x6f\x6e"), array("\x63\x72\x65\141\x74\x65\124\x69\155\x65", "\164\x69\155\145", "\x69\156\163\145\162\164", "\146\165\156\143\164\151\157\x6e")); public function setDataAuto($˜ÖÈÃ¦Ù) { $this->dataAuto = $˜ÖÈÃ¦Ù; } public function __construct($Š·¬ ¸ = '', $†Ê…ˆŒŸ = '', $Ù¸ÅÒÌ» = '') { parent::__construct($Š·¬ ¸, $†Ê…ˆŒŸ, $Ù¸ÅÒÌ»); } protected $tableMeta = array(); protected function _beforeInsert(&$§·ÔÒ¦°, $ãÇ›Øáš) { $ƒ›Í²ò¦ =& $_SERVER[ÆªÈ–¬]; if (!$this->checkDataAutoHas($ƒ›Í²ò¦[431])) { return; } $this->dataBeforeFilter($§·ÔÒ¦°, $ƒ›Í²ò¦[431]); } protected function _beforeUpdate(&$Ÿ¬é„Ùê, $­¬ı„ûº) { $Ï§Ïú–ô =& $_SERVER[ÆªÈ–¬]; if (!$this->checkDataAutoHas($Ï§Ïú–ô[432])) { return; } $this->dataBeforeFilter($Ÿ¬é„Ùê, $Ï§Ïú–ô[432]); } protected function _afterSelect(&$òüçİŸ©, $—†œäûÜ) { if (!is_array($òüçİŸ©)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÆªÈ–¬][433])) { return; } foreach ($òüçİŸ© as &$ƒè÷Çú) { $this->dataAfterFilter($ƒè÷Çú); } unset($ƒè÷Çú); } protected function _afterFind(&$Ë³ÀÏ‹‰, $®²Ê—„Ä) { if (!is_array($Ë³ÀÏ‹‰)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÆªÈ–¬][433])) { return; } $this->dataAfterFilter($Ë³ÀÏ‹‰); } public static function textEncode($˜åï£²) { if (!$˜åï£²) { return $˜åï£²; } $òİ’Òêß = json_encode($˜åï£²); $òİ’Òêß = preg_replace_callback($_SERVER[ÆªÈ–¬][434], function ($ÚñÆãõÌ) { return addslashes($ÚñÆãõÌ[0]); }, $òİ’Òêß); return json_decode($òİ’Òêß); } public static function textDecode($çòØÊî¥) { $…Ş¬ÇÕÄ =& $_SERVER[ÆªÈ–¬]; $’éÙÛÅ’ = json_encode($çòØÊî¥); $’éÙÛÅ’ = preg_replace_callback($…Ş¬ÇÕÄ[435], function ($œŒµ’˜µ) { return $_SERVER[ÆªÈ–¬][100]; }, $’éÙÛÅ’); return json_decode($’éÙÛÅ’); } public function setAutoIncrement($Ü•ãİÎ) { $¤‡ƒäıì = array($this->getPk() => $Ü•ãİÎ); $õ òâÕ = $this->data($¤‡ƒäıì)->add(); if ($õ òâÕ) { $this->delete($õ òâÕ); } } public function getAutoIncrement() { $ˆ¹¯Ô»‡ = $this->getTableName(); $õ‘Á‹Ï = $this->max($this->getPk()); $ ­ĞÏŞÔ = $this->query("\x73\150\x6f\167\x20\x74\141\x62\154\x65\40\163\x74\141\x74\165\163\x20\x77\x68\145\162\x65\x20\x4e\x61\x6d\145\75\47{$ˆ¹¯Ô»‡}\47"); $Ä…Ïùüˆ = $ ­ĞÏŞÔ[0][$_SERVER[ÆªÈ–¬][436]]; $­Å‰ˆæí = max($õ‘Á‹Ï, $Ä…Ïùüˆ); return $­Å‰ˆæí; } protected function _callBefore($·À¨£Ë, $ßˆëª¤ê) { return $this->cacheCallCheck($·À¨£Ë, $ßˆëª¤ê, !1); } protected function _callAfter($âäü º“, $Ú¼áÛŞù) { return $this->cacheCallCheck($âäü º“, $Ú¼áÛŞù, !0); } protected function cacheFunctionAlias($Û¶ã«€ù) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ß÷ãªñî, $¤æ›ø‘É, $¸¯‚ññÎ = false) { $é¡˜€˜õ = $this->cacheFunctionAlias($¤æ›ø‘É); if (!$é¡˜€˜õ) { return; } foreach ($é¡˜€˜õ as $´†º÷›Ù => $Ó’¦á¡Ó) { $º²ášçñ = $Ó’¦á¡Ó[0]; $ŠŞ‹¨ = explode($_SERVER[ÆªÈ–¬][50], $Ó’¦á¡Ó[1]); if ($ß÷ãªñî == $´†º÷›Ù) { return $this->cacheFunctionGet($´†º÷›Ù, $º²ášçñ); } if ($¸¯‚ññÎ && in_array($ß÷ãªñî, $ŠŞ‹¨)) { $this->cacheFunctionClear($´†º÷›Ù, $º²ášçñ); } } } public function cacheFunctionGet($ï¾ì‘ô¦, $ã¤÷»£) { $ éİÓÔò = $this->cacheKeyMake($ï¾ì‘ô¦, $ã¤÷»£); $ªÜŞéÄ = Cache::get($ éİÓÔò); if (!is_array($ªÜŞéÄ)) { $ªÜŞéÄ = call_user_func_array(array($this, $ï¾ì‘ô¦), array($ã¤÷»£, !0)); Cache::set($ éİÓÔò, $ªÜŞéÄ); } return $ªÜŞéÄ; } public function cacheFunctionClear($ıÎ‘Œ´ß, $—÷³àü¢) { $Ïè»õßÂ = $—÷³àü¢; if (!is_array($—÷³àü¢)) { $Ïè»õßÂ = array($—÷³àü¢); } foreach ($Ïè»õßÂ as $ùÑªÔÙ¤) { $Ï©£»´› = $this->cacheKeyMake($ıÎ‘Œ´ß, $ùÑªÔÙ¤); Cache::remove($Ï©£»´›); } } private function cacheKeyMake($‹ç€ãè, $Û½êèÛ) { $ö¿¿¦Ü =& $_SERVER[ÆªÈ–¬]; return get_class($this) . $ö¿¿¦Ü[11] . $‹ç€ãè . $ö¿¿¦Ü[437] . $Û½êèÛ; } protected function selectPageReset() { $À¾æ¸•é =& $_SERVER[ÆªÈ–¬]; if (isset($GLOBALS[$À¾æ¸•é[438]])) { return; } $GLOBALS[$À¾æ¸•é[438]] = isset($GLOBALS[$À¾æ¸•é[7]][$À¾æ¸•é[439]]) ? $GLOBALS[$À¾æ¸•é[7]][$À¾æ¸•é[439]] : !1; $GLOBALS[$À¾æ¸•é[440]] = isset($GLOBALS[$À¾æ¸•é[7]][$À¾æ¸•é[429]]) ? $GLOBALS[$À¾æ¸•é[7]][$À¾æ¸•é[429]] : !1; $GLOBALS[$À¾æ¸•é[7]][$À¾æ¸•é[439]] = !1; $GLOBALS[$À¾æ¸•é[7]][$À¾æ¸•é[429]] = !1; } protected function selectPageRestore() { $™ƒÎìà =& $_SERVER[ÆªÈ–¬]; if (!isset($GLOBALS[$™ƒÎìà[438]])) { return; } $GLOBALS[$™ƒÎìà[7]][$™ƒÎìà[439]] = $GLOBALS[$™ƒÎìà[438]]; $GLOBALS[$™ƒÎìà[7]][$™ƒÎìà[429]] = $GLOBALS[$™ƒÎìà[440]]; if ($GLOBALS[$™ƒÎìà[7]][$™ƒÎìà[439]] === !1) { unset($GLOBALS[$™ƒÎìà[7]][$™ƒÎìà[439]]); } if ($GLOBALS[$™ƒÎìà[7]][$™ƒÎìà[429]] === !1) { unset($GLOBALS[$™ƒÎìà[7]][$™ƒÎìà[429]]); } unset($GLOBALS[$™ƒÎìà[438]]); unset($GLOBALS[$™ƒÎìà[440]]); } protected function selectPage($û­ºÙœ£ = 200, $¨÷°¾„» = 1) { $â”çƒØ… =& $_SERVER[ÆªÈ–¬]; global $in; $ß¡ãşµ· = $this->optionsValue(); $¨©„Ø†û = 50000; $û­ºÙœ£ = isset($in[$â”çƒØ…[439]]) && $in[$â”çƒØ…[439]] ? $in[$â”çƒØ…[439]] : $û­ºÙœ£; if ($û­ºÙœ£ === -1) { $in[$â”çƒØ…[439]] = !1; $¨©„Ø†û = 100000000; $û­ºÙœ£ = $¨©„Ø†û; } $·÷ÃêÌ = $ß¡ãşµ·; $·÷ÃêÌ[$â”çƒØ…[441]] = array(); $û­ºÙœ£ = intval($û­ºÙœ£); $û­ºÙœ£ = $û­ºÙœ£ <= 5 ? 5 : ($û­ºÙœ£ >= $¨©„Ø†û ? $¨©„Ø†û : $û­ºÙœ£); $¨÷°¾„» = intval(isset($in[$â”çƒØ…[429]]) && $in[$â”çƒØ…[429]] ? $in[$â”çƒØ…[429]] : $¨÷°¾„»); $¨÷°¾„» = $¨÷°¾„» <= 1 ? 1 : $¨÷°¾„»; $¸ë¹¯‡— = array(); $Ñù»æêğ = 1; if ($¨÷°¾„» == 1 && $Ñù»æêğ) { $this->optionsValue($ß¡ãşµ·); $¸ë¹¯‡— = $this->page($¨÷°¾„», $û­ºÙœ£)->select(); $¹––ŒÛ = is_array($¸ë¹¯‡—) ? count($¸ë¹¯‡—) : 0; if ($¹––ŒÛ < $û­ºÙœ£) { $ÆÈÏé† = 1; } else { $this->optionsValue($·÷ÃêÌ); $¹––ŒÛ = intval($this->count()); $ÆÈÏé† = ceil($¹––ŒÛ / $û­ºÙœ£); } } else { $this->optionsValue($·÷ÃêÌ); $¹––ŒÛ = intval($this->count()); $ÆÈÏé† = ceil($¹––ŒÛ / $û­ºÙœ£); $¨÷°¾„» = $¨÷°¾„» >= $ÆÈÏé† ? $ÆÈÏé† : $¨÷°¾„»; $this->optionsValue($ß¡ãşµ·); $¸ë¹¯‡— = $this->page($¨÷°¾„», $û­ºÙœ£)->select(); } if (!is_array($¸ë¹¯‡—)) { $¸ë¹¯‡— = array(); } if ($ÆÈÏé† == 1) { $¹––ŒÛ = count($¸ë¹¯‡—); } $Àíáï»… = array($â”çƒØ…[442] => array($â”çƒØ…[443] => $¹––ŒÛ, $â”çƒØ…[439] => $û­ºÙœ£, $â”çƒØ…[429] => $¨÷°¾„», $â”çƒØ…[444] => $ÆÈÏé†), $â”çƒØ…[445] => $¸ë¹¯‡—); return $Àíáï»…; } protected function checkLength($à†Ÿ»úî, $£ìÅÆ¡Ş = 0, $ô­Ê·Ú = '') { $ùø½ÀÓ =& $_SERVER[ÆªÈ–¬]; $£ìÅÆ¡Ş = $£ìÅÆ¡Ş ? $£ìÅÆ¡Ş : 65536; if (!$à†Ÿ»úî || strlen($à†Ÿ»úî) < $£ìÅÆ¡Ş) { return; } $ô­Ê·Ú = $ô­Ê·Ú ? $ô­Ê·Ú . $ùø½ÀÓ[74] : $ùø½ÀÓ[12]; show_json($ô­Ê·Ú . LNG($ùø½ÀÓ[446]) . "\x28{$£ìÅÆ¡Ş}\x29", !1); } protected function metaSet($¶†¤ïÅ, $Š¨µ‘è = null, $ğ…ÍûÊé = null) { $Ôàü³øæ =& $_SERVER[ÆªÈ–¬]; if (!$this->tableMeta || !$¶†¤ïÅ) { return !1; } $şà”ÉÕù = $this->tableMeta[$Ôàü³øæ[447]]; $õäÓ•‘ò = $this->tableMeta[$Ôàü³øæ[448]]; $»òÜÂÎ = Model($õäÓ•‘ò); $¼©…ŞÜÌ = array($şà”ÉÕù => $¶†¤ïÅ, $Ôàü³øæ[449] => $Š¨µ‘è); if (is_null($Š¨µ‘è)) { return $»òÜÂÎ->where(array($şà”ÉÕù => $¶†¤ïÅ))->delete(); } if (is_null($ğ…ÍûÊé) && is_string($Š¨µ‘è)) { return $»òÜÂÎ->where($¼©…ŞÜÌ)->delete(); } $¸Óıø€± = is_array($Š¨µ‘è) ? $Š¨µ‘è : array(); if (is_string($Š¨µ‘è)) { $¸Óıø€±[$Š¨µ‘è] = $ğ…ÍûÊé; } $ÁÕãíó = array(); foreach ($¸Óıø€± as $ä½•ä‰ø => $…“ŞÂ–) { if (is_null($…“ŞÂ–) && is_string($ä½•ä‰ø)) { $»òÜÂÎ->where(array($şà”ÉÕù => $¶†¤ïÅ, $Ôàü³øæ[449] => $ä½•ä‰ø))->delete(); continue; } $this->checkLength($…“ŞÂ–, !1, $õäÓ•‘ò . $Ôàü³øæ[4] . $ä½•ä‰ø); $ÁÕãíó[] = array($şà”ÉÕù => $¶†¤ïÅ, $Ôàü³øæ[97] => $ä½•ä‰ø, $Ôàü³øæ[450] => $…“ŞÂ–); } $ªğç‰û© = $Ôàü³øæ[451] . $õäÓ•‘ò; CacheLock::lock($ªğç‰û©); $»òÜÂÎ->where(array($şà”ÉÕù => $¶†¤ïÅ))->addAll($ÁÕãíó, array(), !0); CacheLock::unlock($ªğç‰û©); return !0; } public function metaGet($·şë½äĞ, $¬ˆ¤û½û = false) { $…Ö¡ ¹‘ =& $_SERVER[ÆªÈ–¬]; if (!$this->tableMeta) { return array(); } $‚³’íÄ­ = $this->tableMeta[$…Ö¡ ¹‘[447]]; $âóãçÍ = Model($this->tableMeta[$…Ö¡ ¹‘[448]]); if ($¬ˆ¤û½û) { $óÃ÷Öı¼ = array($‚³’íÄ­ => $·şë½äĞ, $…Ö¡ ¹‘[97] => $¬ˆ¤û½û); return $âóãçÍ->where($óÃ÷Öı¼)->getField($…Ö¡ ¹‘[450]); } $óÃ÷Öı¼ = array($‚³’íÄ­ => $·şë½äĞ); $“é÷»¸® = $âóãçÍ->field($…Ö¡ ¹‘[452])->where($óÃ÷Öı¼)->select(); $“é÷»¸® = array_to_keyvalue($“é÷»¸®, $…Ö¡ ¹‘[97], $…Ö¡ ¹‘[450]); return $“é÷»¸®; } private function checkDataAutoHas($İ…¬†„½) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $è•ÉŞ™«) { if (in_array($İ…¬†„½, explode($_SERVER[ÆªÈ–¬][50], $è•ÉŞ™«[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ıÀŒîåö, $ãõ°¿ô¹) { $ÑëÖåÌ =& $_SERVER[ÆªÈ–¬]; if (!is_array($ıÀŒîåö)) { return; } foreach ($this->dataAuto as $«à À·) { $¾«ûí–‚ = $«à À·[0]; if (!in_array($ãõ°¿ô¹, explode($ÑëÖåÌ[50], $«à À·[2]))) { continue; } switch (trim($«à À·[3])) { case $ÑëÖåÌ[397]: case $ÑëÖåÌ[398]: $ÚêóÃÈ‚ = $«à À·[1]; $›“¬†Ã = isset($«à À·[4]) ? (array) $«à À·[4] : array(); if ($ÚêóÃÈ‚ == $ÑëÖåÌ[206] && array_key_exists($¾«ûí–‚, $ıÀŒîåö)) { if (!$ıÀŒîåö[$¾«ûí–‚]) { unset($ıÀŒîåö[$¾«ûí–‚]); } break; } if (isset($ıÀŒîåö[$¾«ûí–‚])) { array_unshift($›“¬†Ã, $ıÀŒîåö[$¾«ûí–‚]); } if ($ÑëÖåÌ[397] == $«à À·[3]) { $ıÀŒîåö[$¾«ûí–‚] = call_user_func_array($ÚêóÃÈ‚, $›“¬†Ã); } else { $ıÀŒîåö[$¾«ûí–‚] = call_user_func_array(array(&$this, $ÚêóÃÈ‚), $›“¬†Ã); } break; case $ÑëÖåÌ[347]: if (isset($ıÀŒîåö[$¾«ûí–‚]) && $ıÀŒîåö[$¾«ûí–‚]) { $ıÀŒîåö[$¾«ûí–‚] = call_user_func_array(array(&$this, $«à À·[1]), array($ıÀŒîåö[$¾«ûí–‚])); } break; case $ÑëÖåÌ[350]: $ıÀŒîåö[$¾«ûí–‚] = $ıÀŒîåö[$«à À·[1]]; break; case $ÑëÖåÌ[370]: if (isset($ıÀŒîåö[$¾«ûí–‚]) && !is_string($ıÀŒîåö[$¾«ûí–‚])) { $ıÀŒîåö[$¾«ûí–‚] = json_encode_force($ıÀŒîåö[$¾«ûí–‚]); } break; case $ÑëÖåÌ[399]: if ($ıÀŒîåö[$¾«ûí–‚] === $ÑëÖåÌ[12]) { unset($ıÀŒîåö[$¾«ûí–‚]); } break; case $ÑëÖåÌ[400]: $ıÀŒîåö[$¾«ûí–‚] = $«à À·[1]; default: break; } } if ($ãõ°¿ô¹ == $ÑëÖåÌ[431]) { $µØıÂçÂ = strtolower($this->db->getDbType()); if (strpos($µØıÂçÂ, $ÑëÖåÌ[13]) !== 0) { return; } $àİ€ËÚ = $this->field(!0)->fields; $×Ï‹„Òİ = $àİ€ËÚ[$ÑëÖåÌ[329]]; if (isset($àİ€ËÚ[$ÑëÖåÌ[328]])) { unset($×Ï‹„Òİ[$àİ€ËÚ[$ÑëÖåÌ[328]]]); } foreach ($×Ï‹„Òİ as $û¯Ìæ½· => $ãõ°¿ô¹) { if (!isset($ıÀŒîåö[$û¯Ìæ½·])) { $ıÀŒîåö[$û¯Ìæ½·] = $ÑëÖåÌ[12]; } } } } private function dataAfterFilter(&$É×”ŠÏï) { $î²Çóä =& $_SERVER[ÆªÈ–¬]; foreach ($this->dataAuto as $¹‚Ş±ö‚) { $•Ãä¸Ç = $¹‚Ş±ö‚[0]; if (!isset($É×”ŠÏï[$•Ãä¸Ç])) { continue; } if (!in_array($î²Çóä[433], explode($î²Çóä[50], $¹‚Ş±ö‚[2]))) { continue; } switch (trim($¹‚Ş±ö‚[3])) { case $î²Çóä[397]: case $î²Çóä[398]: $ã¦ŒÆ  = isset($¹‚Ş±ö‚[4]) ? (array) $¹‚Ş±ö‚[4] : array(); array_unshift($ã¦ŒÆ , $É×”ŠÏï[$•Ãä¸Ç]); if (isset($¹‚Ş±ö‚[4]) && $¹‚Ş±ö‚[4] == $î²Çóä[453]) { $ã¦ŒÆ  = array($É×”ŠÏï[$•Ãä¸Ç]); } if ($î²Çóä[397] == $¹‚Ş±ö‚[3]) { $É×”ŠÏï[$•Ãä¸Ç] = call_user_func_array($¹‚Ş±ö‚[1], $ã¦ŒÆ ); } else { $É×”ŠÏï[$•Ãä¸Ç] = call_user_func_array(array(&$this, $¹‚Ş±ö‚[1]), $ã¦ŒÆ ); } break; case $î²Çóä[347]: if (isset($É×”ŠÏï[$•Ãä¸Ç]) && $É×”ŠÏï[$•Ãä¸Ç]) { $É×”ŠÏï[$•Ãä¸Ç] = call_user_func_array(array(&$this, $¹‚Ş±ö‚[1]), array($É×”ŠÏï[$•Ãä¸Ç])); } break; case $î²Çóä[350]: $É×”ŠÏï[$•Ãä¸Ç] = $É×”ŠÏï[$¹‚Ş±ö‚[1]]; break; case $î²Çóä[370]: $Şõ´ßĞé = $É×”ŠÏï[$•Ãä¸Ç]; $É×”ŠÏï[$•Ãä¸Ç] = json_decode($Şõ´ßĞé, !0); if (is_null($É×”ŠÏï[$•Ãä¸Ç])) { $É×”ŠÏï[$•Ãä¸Ç] = $Şõ´ßĞé; } break; case $î²Çóä[399]: if ($É×”ŠÏï[$•Ãä¸Ç] === $î²Çóä[12]) { unset($É×”ŠÏï[$•Ãä¸Ç]); } break; case $î²Çóä[400]: $É×”ŠÏï[$•Ãä¸Ç] = $¹‚Ş±ö‚[1]; break; default: break; } } } public function saveAll($ª˜õó‚æ) { $½İüŠ‚Û =& $_SERVER[ÆªÈ–¬]; $²¾ûÈüƒ = $this->tablePrefix . $this->tableName; $¶Áí®„‘ = self::SQL_WHERE_IN_CHUNK; $ª˜õó‚æ = is_array($ª˜õó‚æ) ? $ª˜õó‚æ : array(); $ĞıÓÈÂ² = $½İüŠ‚Û[454]; $üµ–½Æ = 0; $…—›•Ë = array(); $‡äøŒ÷ = count($ª˜õó‚æ); for ($îÄµÑÙ = 0; $îÄµÑÙ < $‡äøŒ÷; $îÄµÑÙ++) { $æÉ¢Š = $ª˜õó‚æ[$îÄµÑÙ]; if (!is_array($æÉ¢Š) || count($æÉ¢Š) != 4) { continue; } $…Â„ªùª = "\125\120\x44\101\x54\105\x20\140{$²¾ûÈüƒ}\x60\40\123\x45\124\x20{$æÉ¢Š[2]}\40\x3d\40\103\x41\123\105\x20{$æÉ¢Š[0]}\x20\12"; if ($üµ–½Æ == 0) { $ĞıÓÈÂ² = $…Â„ªùª; } $…—›•Ë[] = $½İüŠ‚Û[121] . $æÉ¢Š[1] . $½İüŠ‚Û[121]; $üµ–½Æ++; $ĞıÓÈÂ² .= "\40\x57\110\105\116\x20\x27{$æÉ¢Š[1]}\47\x20\124\x48\105\x4e\x20\47{$æÉ¢Š[3]}\47\x20\xa"; if ($üµ–½Æ == $¶Áí®„‘ || $îÄµÑÙ == $‡äøŒ÷ - 1) { $ªïµéÒƒ = implode($½İüŠ‚Û[50], $…—›•Ë); $ĞıÓÈÂ² .= "\x20\105\x4e\104\x20\x20\127\x48\105\x52\x45\x20{$æÉ¢Š[0]}\x20\x49\116\x20\x28{$ªïµéÒƒ}\51\x20"; $this->execute($ĞıÓÈÂ²); $üµ–½Æ = 0; $ĞıÓÈÂ² = $…Â„ªùª; $this->chunkEventCheck(count($…—›•Ë)); $…—›•Ë = array(); } } $this->chunkEventSet(); } public function saveAllEach($õ—†Î˜) { $­¿Â‚× =& $_SERVER[ÆªÈ–¬]; $úß÷É²Õ = $this->tablePrefix . $this->tableName; foreach ($õ—†Î˜ as $ŠìÔ¢ˆÖ) { if (!is_array($ŠìÔ¢ˆÖ) || count($ŠìÔ¢ˆÖ) != 4) { continue; } $°ˆ‹ÍÍê = $ŠìÔ¢ˆÖ[0] . $­¿Â‚×[455] . $ŠìÔ¢ˆÖ[1] . $­¿Â‚×[121]; $Ö’õô¶ = $ŠìÔ¢ˆÖ[2] . $­¿Â‚×[455] . $ŠìÔ¢ˆÖ[3] . $­¿Â‚×[121]; $†Æïî¥ƒ = "\165\x70\144\x61\164\145\40{$úß÷É²Õ}\40\163\145\164\x20{$Ö’õô¶}\40\x77\x68\x65\x72\x65\40{$°ˆ‹ÍÍê}\x3b"; $this->execute($†Æïî¥ƒ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($µòı˜¾ø = false, $Ã»Œ¾ø¹ = false) { $this->_chunkEvent = $µòı˜¾ø; $this->_chunkEventParam = $Ã»Œ¾ø¹; } private function chunkEventCheck($øÇ‘Ûø’) { if (!$this->_chunkEvent) { return; } $ÍËÔ»‡« = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÍËÔ»‡«[$_SERVER[ÆªÈ–¬][456]] = $øÇ‘Ûø’; Hook::trigger($this->_chunkEvent, $ÍËÔ»‡«); } public function addAll($«‚±ªî, $²º ë = array(), $÷›ÈâŒ = false) { $™Š¢ÓÀ¸ =& $_SERVER[ÆªÈ–¬]; ignore_timeout(); $ŸÇ¡²ğ¤ = self::SQL_WHERE_IN_CHUNK; if (empty($«‚±ªî)) { $this->error = think_lang($™Š¢ÓÀ¸[348]); return !1; } $²º ë = $this->_parseOptions($²º ë); foreach ($«‚±ªî as $”©‘ó•“ => $ş©¿ğíî) { $«‚±ªî[$”©‘ó•“] = $this->_facade($ş©¿ğíî); $this->_beforeInsert($«‚±ªî[$”©‘ó•“], $²º ë); } if (method_exists($this->db, $™Š¢ÓÀ¸[349])) { for ($–ÔˆÕ³ = 0; $–ÔˆÕ³ < count($«‚±ªî); $–ÔˆÕ³ += $ŸÇ¡²ğ¤) { $ÑÕø´¤ = array_slice($«‚±ªî, $–ÔˆÕ³, $ŸÇ¡²ğ¤); if (!is_array($ÑÕø´¤) || count($ÑÕø´¤) == 0) { break; } $Ú£š…» = $this->db->insertAll($ÑÕø´¤, $²º ë, $÷›ÈâŒ); $this->chunkEventCheck(count($ÑÕø´¤)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($«‚±ªî as $”©‘ó•“ => $ş©¿ğíî) { $Ú£š…» = $this->db->insert($ş©¿ğíî, $²º ë, $÷›ÈâŒ); } $this->commit(); } if (!1 !== $Ú£š…») { $ìÒ÷Û = $this->getLastInsID(); if ($ìÒ÷Û) { return $ìÒ÷Û; } } return $Ú£š…»; } public function save($²™´¿§æ = '', $§Õ§´«ö = array()) { $³äÌ‹ø =& $_SERVER[ÆªÈ–¬]; $ÕåÁÛÆ = self::SQL_WHERE_IN_CHUNK; $ëÜ¨ĞÇ… = $this->optionsValue(); $­¬‡ï¡› = $this->findWhereField($ëÜ¨ĞÇ…); if (!$­¬‡ï¡›) { return parent::save($²™´¿§æ, $§Õ§´«ö); } $°¢Üæâ× = 0; $Õö‡±Úü = $ëÜ¨ĞÇ…[$³äÌ‹ø[352]][$­¬‡ï¡›][1]; $Õö‡±Úü = is_array($Õö‡±Úü) ? $Õö‡±Úü : array(); $ĞëŸÔÍ = count($Õö‡±Úü); for ($âß¡¾˜Á = 0; $âß¡¾˜Á < $ĞëŸÔÍ; $âß¡¾˜Á += $ÕåÁÛÆ) { $´¬«ö¶ = array_slice($Õö‡±Úü, $âß¡¾˜Á, $ÕåÁÛÆ); if (!is_array($´¬«ö¶) || count($´¬«ö¶) == 0) { break; } $ëÜ¨ĞÇ…[$³äÌ‹ø[352]][$­¬‡ï¡›][1] = $´¬«ö¶; $this->optionsValue($ëÜ¨ĞÇ…); $°¢Üæâ× += parent::save($²™´¿§æ, $§Õ§´«ö); $this->chunkEventCheck(count($´¬«ö¶)); } $this->chunkEventSet(); return $°¢Üæâ×; } public function add($äÆ‡úæÛ = '', $¯é¹òİû = array(), $‚é€ŸÎ– = false) { if ($this->addTaskStatus && is_array($äÆ‡úæÛ)) { $this->addTaskData[] = $äÆ‡úæÛ; return; } return parent::add($äÆ‡úæÛ, $¯é¹òİû, $‚é€ŸÎ–); } public function parseWhereLike($òàìû•Æ, $ı¿†€âĞ = '', $ô¦ÀçĞ  = false, &$›ó³œÂë = false) { $íÍä¯Áœ =& $_SERVER[ÆªÈ–¬]; $ÁĞ†ú³ğ = $GLOBALS[$íÍä¯Áœ[6]][$íÍä¯Áœ[457]]; if (!$ÁĞ†ú³ğ[$íÍä¯Áœ[458]]) { return $òàìû•Æ; } if (!is_array($òàìû•Æ)) { return $òàìû•Æ; } $ü·”™£ï = array(); $ƒ‹Œûó² = 0; foreach ($òàìû•Æ as $¿„åÍÑ => $îêŠßî«) { if (is_array($îêŠßî«) && count($îêŠßî«) == 2 && $îêŠßî«[0] == $íÍä¯Áœ[459] && is_string($îêŠßî«[1]) && substr($îêŠßî«[1], 0, 1) == $íÍä¯Áœ[460] && substr($îêŠßî«[1], strlen($îêŠßî«[1]) - 1, 1) == $íÍä¯Áœ[460]) { $›ó³œÂë = !0; $³íáÑË = is_string($¿„åÍÑ) ? $¿„åÍÑ : $ı¿†€âĞ; $ğ†Î”£˜ = substr($îêŠßî«[1], 1, strlen($îêŠßî«[1]) - 2); $ğ†Î”£˜ = $this->db->escapeString($ğ†Î”£˜); if (!strpos($³íáÑË, $íÍä¯Áœ[10])) { $³íáÑË = $íÍä¯Áœ[461] . $³íáÑË . $íÍä¯Áœ[461]; } $ —İŸ¬ö = $íÍä¯Áœ[220] . $ğ†Î”£˜ . $íÍä¯Áœ[220]; $ğ†Î”£˜ = str_replace(array($íÍä¯Áœ[10], $íÍä¯Áœ[462], $íÍä¯Áœ[11]), $íÍä¯Áœ[463], $ğ†Î”£˜); if ($ÁĞ†ú³ğ[$íÍä¯Áœ[464]]) { $ —İŸ¬ö = $íÍä¯Áœ[465] . $ğ†Î”£˜ . $íÍä¯Áœ[466]; if ($ÁĞ†ú³ğ[$íÍä¯Áœ[467]]) { $ —İŸ¬ö = $íÍä¯Áœ[466] . $ğ†Î”£˜ . $íÍä¯Áœ[465]; } } $ü·”™£ï[$ƒ‹Œûó²] = $íÍä¯Áœ[468] . $³íáÑË . $íÍä¯Áœ[469] . $ —İŸ¬ö . $íÍä¯Áœ[470]; $ƒ‹Œûó²++; continue; } if (is_array($îêŠßî«)) { $ı¿†€âĞ = is_string($¿„åÍÑ) ? $¿„åÍÑ : $ı¿†€âĞ; $îêŠßî« = $this->parseWhereLike($îêŠßî«, $ı¿†€âĞ, !0, $›ó³œÂë); } if (is_numeric($¿„åÍÑ)) { $ü·”™£ï[$ƒ‹Œûó²] = $îêŠßî«; $ƒ‹Œûó²++; } else { $ü·”™£ï[$¿„åÍÑ] = $îêŠßî«; } } if ($›ó³œÂë && !$ô¦ÀçĞ ) { } return $ü·”™£ï; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¤Æ²¡³í = array()) { $øí›’Ë =& $_SERVER[ÆªÈ–¬]; $ñ´è¯† = self::SQL_WHERE_IN_CHUNK; $Ò€¯Û†© = $this->optionsValue(); $ñŸæÂ×— = $this->findWhereField($Ò€¯Û†©); if (!$ñŸæÂ×— || isset($Ò€¯Û†©[$øí›’Ë[368]]) || isset($Ò€¯Û†©[$øí›’Ë[429]])) { return parent::select($¤Æ²¡³í); } $Èƒà›ËÕ = $Ò€¯Û†©[$øí›’Ë[352]][$ñŸæÂ×—][1]; $Èƒà›ËÕ = is_array($Èƒà›ËÕ) ? $Èƒà›ËÕ : array(); $°¢åéí = null; for ($À½Â‡Ç´ = 0; $À½Â‡Ç´ < count($Èƒà›ËÕ); $À½Â‡Ç´ += $ñ´è¯†) { $ò×¹—Õ± = array_slice($Èƒà›ËÕ, $À½Â‡Ç´, $ñ´è¯†); if (!is_array($ò×¹—Õ±) || count($ò×¹—Õ±) == 0) { break; } $Ò€¯Û†©[$øí›’Ë[352]][$ñŸæÂ×—][1] = $ò×¹—Õ±; $this->optionsValue($Ò€¯Û†©); $±ÍñˆÆ = parent::select($¤Æ²¡³í); if (!$±ÍñˆÆ) { continue; } $°¢åéí = is_array($°¢åéí) ? $°¢åéí : array(); $°¢åéí = array_merge($°¢åéí, $±ÍñˆÆ); } return $°¢åéí; } public function delete($ü’€£ãı = array()) { $‡¤¹®‡å =& $_SERVER[ÆªÈ–¬]; $ˆ¬ïûÜ¡ = self::SQL_WHERE_IN_CHUNK; $ÓÄ¹íÔï = $this->optionsValue(); $ÓÖƒ¨¸– = $this->findWhereField($ÓÄ¹íÔï); if (!$ÓÖƒ¨¸–) { return parent::delete($ü’€£ãı); } $ÍÍŞø« = 0; $³ûô†§ = $ÓÄ¹íÔï[$‡¤¹®‡å[352]][$ÓÖƒ¨¸–][1]; $³ûô†§ = is_array($³ûô†§) ? $³ûô†§ : array(); for ($ôí°¢Ú = 0; $ôí°¢Ú < count($³ûô†§); $ôí°¢Ú += $ˆ¬ïûÜ¡) { $¹…‘Õ“ = array_slice($³ûô†§, $ôí°¢Ú, $ˆ¬ïûÜ¡); if (!is_array($¹…‘Õ“) || count($¹…‘Õ“) == 0) { break; } $ÓÄ¹íÔï[$‡¤¹®‡å[352]][$ÓÖƒ¨¸–][1] = $¹…‘Õ“; $this->optionsValue($ÓÄ¹íÔï); $ÍÍŞø« += parent::delete($ü’€£ãı); } return $ÍÍŞø«; } private function findWhereField($¸Ôˆá¢) { $ö»Ã÷Âß =& $_SERVER[ÆªÈ–¬]; $óÖ…ô§— = self::SQL_WHERE_IN_CHUNK; if (!is_array($¸Ôˆá¢) || !is_array($¸Ôˆá¢[$ö»Ã÷Âß[352]])) { return !1; } foreach ($¸Ôˆá¢[$ö»Ã÷Âß[352]] as $ïÅÄŠ¢Ø => $¡ûšÄ‰Š) { if (is_array($¡ûšÄ‰Š) && isset($¡ûšÄ‰Š[0]) && is_string($¡ûšÄ‰Š[0]) && strtolower($¡ûšÄ‰Š[0]) == $ö»Ã÷Âß[7] && is_array($¡ûšÄ‰Š[1]) && count($¡ûšÄ‰Š[1]) > $óÖ…ô§—) { ignore_timeout(); return $ïÅÄŠ¢Ø; } } return !1; } public function setMasterDB($¥‚‹›©— = true) { think_config($_SERVER[ÆªÈ–¬][471], $¥‚‹›©—); } } goto FºÆ¨µäÔÄ; DŠ°ó²Ûª: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¦ÂŞŞé) { $this->pathParse = $¦ÂŞŞé; $this->model = Model($_SERVER[ÆªÈ–¬][1411]); } protected function infoParse($¤‡şéÈ, $€ú è“ = false, $êß¿à¯Ş = false) { $ë—ı¹‹˜ =& $_SERVER[ÆªÈ–¬]; return Action($ë—ı¹‹˜[1249])->sharePathInfo($this->pathParse[$ë—ı¹‹˜[87]], !0, $€ú è“); } public function listPath($Ñ¥å×‘´, $šìòöÇº = false) { $ÍÕ÷áç =& $_SERVER[ÆªÈ–¬]; $áÃ×ĞíÊ = parent::listPath($Ñ¥å×‘´, $šìòöÇº); if (!$áÃ×ĞíÊ) { return $áÃ×ĞíÊ; } if (is_array($áÃ×ĞíÊ[$ÍÕ÷áç[1419]])) { $áÃ×ĞíÊ[$ÍÕ÷áç[1419]] = Action($ÍÕ÷áç[1249])->shareItemInfo($áÃ×ĞíÊ[$ÍÕ÷áç[1419]]); } foreach ($áÃ×ĞíÊ as $ÈÁ»ôëú => $ìË×æ½½) { if (!in_array($ÈÁ»ôëú, array($ÍÕ÷áç[86], $ÍÕ÷áç[85]))) { continue; } foreach ($ìË×æ½½ as $ŞÖ¿Ñİ => $¬ñ¸Üªƒ) { $áÃ×ĞíÊ[$ÈÁ»ôëú][$ŞÖ¿Ñİ] = Action($ÍÕ÷áç[1249])->shareItemInfo($¬ñ¸Üªƒ); } } return $áÃ×ĞíÊ; } public function listAll($ŒŸ°ºäô) { $Ñ¬£°Ü =& $_SERVER[ÆªÈ–¬]; $âåŠÂ—í = IO::info($this->pathParse[$Ñ¬£°Ü[87]]); if (!$âåŠÂ—í) { return array(); } $“§ƒ›ˆ = $this->model->listAll($ŒŸ°ºäô); foreach ($“§ƒ›ˆ as &$ĞŸ˜¦µò) { $ĞŸ˜¦µò[$Ñ¬£°Ü[90]] = Action($Ñ¬£°Ü[1249])->shareItemInfo($ĞŸ˜¦µò[$Ñ¬£°Ü[90]]); } unset($ĞŸ˜¦µò); return $“§ƒ›ˆ; } } class PathDriverDriverShareItem { public function __construct($ÎûòÊˆ) { $this->pathParse = $ÎûòÊˆ; } public function __call($ ªÑÈ³¸, $”¸®Ó€‹) { $Ê ìû‚· =& $_SERVER[ÆªÈ–¬]; if (method_exists($this, $ ªÑÈ³¸)) { return; } $„«‡•ÆÁ = call_user_func_array(array($Ê ìû‚·[1420], $ ªÑÈ³¸), $”¸®Ó€‹); $Ú´‘“ê = array($Ê ìû‚·[1421], $Ê ìû‚·[1422], $Ê ìû‚·[1423], $Ê ìû‚·[1424], $Ê ìû‚·[618], $Ê ìû‚·[620], $Ê ìû‚·[1425], $Ê ìû‚·[110], $Ê ìû‚·[1426], $Ê ìû‚·[1427]); if (in_array($ ªÑÈ³¸, $Ú´‘“ê)) { $„«‡•ÆÁ = $this->getPathOuter($„«‡•ÆÁ); } return $„«‡•ÆÁ; } public function copy($µùÕúéú, $³âõÄ˜, $àß“Ñ‹å = false, $ßä„•øµ = false) { return $this->copyMove($µùÕúéú, $³âõÄ˜, $àß“Ñ‹å, $_SERVER[ÆªÈ–¬][618], $ßä„•øµ); } public function move($õïçıì, $’ÇÖí­, $àË ×³± = false, $Ç¼¤â = false) { return $this->copyMove($õïçıì, $’ÇÖí­, $àË ×³±, $_SERVER[ÆªÈ–¬][620], $Ç¼¤â); } private function copyMove($Â¬«¡¶, $ü¦“©“, $½¦Íñ°‹, $­Ìòì½, $«…õÕéÀ = false) { $ËÄş¢ï¤ =& $_SERVER[ÆªÈ–¬]; $•€ßÜÇ„ = $ü¦“©“; $™È™˜¾ = IO::driverMake($ü¦“©“); if ($™È™˜¾->pathParse[$ËÄş¢ï¤[1225]]) { $ü¦“©“ = $™È™˜¾->pathParse[$ËÄş¢ï¤[1225]]; } else { $ü¦“©“ = $•€ßÜÇ„; } $Ş¤Ôøß = IO::copyMove($Â¬«¡¶, $ü¦“©“, $½¦Íñ°‹, $­Ìòì½, $«…õÕéÀ); $Ş¤Ôøß = $this->getPathOuter($Ş¤Ôøß); return $Ş¤Ôøß; } public function pathThis($ƒìºô¸) { return get_path_this($this->pathParse[$_SERVER[ÆªÈ–¬][87]]); } public function pathFather($­­âÂÛØ) { return get_path_father($this->pathParse[$_SERVER[ÆªÈ–¬][87]]); } public function iconvSystem($¾¥ßíì€) { return $¾¥ßíì€; } protected function infoParse($É÷º¬ßã, $ñàÒÉ’¬ = false) { $ŒÍ“—À =& $_SERVER[ÆªÈ–¬]; $²ÁıÃ»ù = $this->pathParse[$ŒÍ“—À[560]][$ŒÍ“—À[1250]] . $this->pathParse[$ŒÍ“—À[1243]]; if ($ñàÒÉ’¬) { $££ı”œó = IO::infoWithChildren($²ÁıÃ»ù); } else { $££ı”œó = IO::info($²ÁıÃ»ù); } $Ò•à¨è = $this->pathParse[$ŒÍ“—À[560]]; return Action($ŒÍ“—À[1418])->_shareItemeParse($££ı”œó, $Ò•à¨è); } public function listAll($÷´¤ü®) { $µ¨™©ñŒ =& $_SERVER[ÆªÈ–¬]; $œİµÌ“Ñ = IO::listAll($÷´¤ü®); $†ÈÌ¥ = rtrim($this->pathParse[$µ¨™©ñŒ[560]][$µ¨™©ñŒ[1250]], $µ¨™©ñŒ[8]); foreach ($œİµÌ“Ñ as &$»·ŠÈ) { $»·ŠÈ[$µ¨™©ñŒ[87]] = $this->pathDriver . $µ¨™©ñŒ[8] . ltrim(substr($»·ŠÈ[$µ¨™©ñŒ[87]], strlen($†ÈÌ¥)), $µ¨™©ñŒ[8]); } unset($»·ŠÈ); return $œİµÌ“Ñ; } public function listAllSimple($Ø–é„†ˆ, $Ã˜á¯Àë = false) { $Ä´ıÓ¦á =& $_SERVER[ÆªÈ–¬]; $Ë¹ä²¶ = $this->listAll($Ø–é„†ˆ); $ê™Ş”Şè = $this->pathParse[$Ä´ıÓ¦á[495]]; if (trim($ê™Ş”Şè, $Ä´ıÓ¦á[8]) == trim(get_path_father($ê™Ş”Şè), $Ä´ıÓ¦á[8])) { $Ã˜á¯Àë = !0; } return IO::init($Ä´ıÓ¦á[12])->listAllSimpleMake($Ë¹ä²¶, $ê™Ş”Şè, $Ã˜á¯Àë); } public function getPathOuter($ã–ë‚çû) { $°Ú«Ã»« =& $_SERVER[ÆªÈ–¬]; $¸ÊÉâœÓ = KodIO::parse($ã–ë‚çû); if ($¸ÊÉâœÓ[$°Ú«Ã»«[33]] == KodIO::KOD_SHARE_ITEM) { return $¸ÊÉâœÓ[$°Ú«Ã»«[87]]; } $°öÅ‡½† = KodIO::clear($ã–ë‚çû); $¨íÎ·¹ = KodIO::clear($this->pathParse[$°Ú«Ã»«[560]][$°Ú«Ã»«[1250]]); $¹ûÏ‹ç = substr($°öÅ‡½†, strlen($¨íÎ·¹)); if (substr($°öÅ‡½†, 0, strlen($¨íÎ·¹)) != $¨íÎ·¹) { return !1; } return $this->pathParse[$°Ú«Ã»«[1244]] . $°Ú«Ã»«[8] . ltrim($¹ûÏ‹ç, $°Ú«Ã»«[8]); } public function getType() { $Õ­Ù¦¾ş =& $_SERVER[ÆªÈ–¬]; $„óâş‚ô = str_replace($Õ­Ù¦¾ş[77], $Õ­Ù¦¾ş[12], get_class($this)); return strtolower($„óâş‚ô); } public function isOsDriver($ŸÂ¸ò¨…) { return IO::isOsDriver($ŸÂ¸ò¨…); } public function info($®É–âÖ°) { return $this->infoParse($®É–âÖ°); } public function infoAuth($¤ÉÇÖŸ­) { return $this->infoParse($¤ÉÇÖŸ­); } public function infoWithChildren($üÜ¢®Š›) { return $this->infoParse($üÜ¢®Š›, !0); } public function infoFull($«’•âå) { return $this->infoParse($«’•âå); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($äù‘¨¨ı) { $this->pathParse = $äù‘¨¨ı; } protected function infoParse($ÕÉµè£ß, $Í”‹·Õ = false) { $Áå¹ÜÛû =& $_SERVER[ÆªÈ–¬]; return Action($Áå¹ÜÛû[1249])->sharePathInfo($this->pathParse[$Áå¹ÜÛû[87]], !0, $Í”‹·Õ); } public function listPath($¢Ê¶ì­£, $¡Ô«®³ë = false) { $®š…‡·Œ =& $_SERVER[ÆªÈ–¬]; $¸Õ÷óÚÂ = IO::listPath($¢Ê¶ì­£, $¡Ô«®³ë); if (!$¸Õ÷óÚÂ) { return $¸Õ÷óÚÂ; } if (is_array($¸Õ÷óÚÂ[$®š…‡·Œ[1419]])) { $ñŠé‚ãÒ = Action($®š…‡·Œ[1428])->parsePathChildren($¸Õ÷óÚÂ[$®š…‡·Œ[1419]], array($®š…‡·Œ[495] => $¢Ê¶ì­£)); $¸Õ÷óÚÂ[$®š…‡·Œ[1419]] = Action($®š…‡·Œ[1249])->shareItemInfo($ñŠé‚ãÒ); } foreach ($¸Õ÷óÚÂ as $‚©å¹øÙ => $ñ¾Î–âÅ) { if (!in_array($‚©å¹øÙ, array($®š…‡·Œ[86], $®š…‡·Œ[85]))) { continue; } foreach ($ñ¾Î–âÅ as $ø¹ğÊû¡ => $ñŠé‚ãÒ) { $ñŠé‚ãÒ = Action($®š…‡·Œ[1428])->parsePathChildren($ñŠé‚ãÒ, array($®š…‡·Œ[495] => $¢Ê¶ì­£)); $¸Õ÷óÚÂ[$‚©å¹øÙ][$ø¹ğÊû¡] = Action($®š…‡·Œ[1249])->shareItemInfo($ñŠé‚ãÒ); } } return $¸Õ÷óÚÂ; } } goto f¡ÓÈ„±”’; dÛÓ»­ˆò: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($È¯šğ˜) { $Åú¦‡µµ =& $_SERVER[ÆªÈ–¬]; $¹‰àè½Á = KodIO::fileTypeList(); $Û‹®‡½‡ = $¹‰àè½Á[$È¯šğ˜]; if (!$Û‹®‡½‡) { return array(); } $¢¡´ÖÙÏ = $Û‹®‡½‡[$Åú¦‡µµ[169]]; $„ŞÜ¼ÛÏ = $Åú¦‡µµ[7]; if (!$Û‹®‡½‡[$Åú¦‡µµ[169]]) { $‘ÛÇßÏÃ = array_to_keyvalue($¹‰àè½Á, $Åú¦‡µµ[12], $Åú¦‡µµ[169]); $¢¡´ÖÙÏ = implode($Åú¦‡µµ[50], $‘ÛÇßÏÃ); $„ŞÜ¼ÛÏ = $Åú¦‡µµ[2226]; } $Šò¶šáÛ = explode($Åú¦‡µµ[50], trim($¢¡´ÖÙÏ, $Åú¦‡µµ[50])); return array($„ŞÜ¼ÛÏ, $Šò¶šáÛ); } public function listPathType($ö‚”éèç) { $½ß¶í™ı =& $_SERVER[ÆªÈ–¬]; $êŞ½î• = $this->fileTypeWhere($ö‚”éèç); if (!$êŞ½î•) { return array(); } $¹İÉíÙ = USER_ID; $îŠµòç‘ = Model($½ß¶í™ı[598])->getInfo($¹İÉíÙ); $ìëİ¸¥¿ = array($½ß¶í™ı[648] => SourceModel::TYPE_USER, $½ß¶í™ı[584] => array($½ß¶í™ı[612], $½ß¶í™ı[594] . $îŠµòç‘[$½ß¶í™ı[90]][$½ß¶í™ı[193]] . $½ß¶í™ı[613]), $½ß¶í™ı[649] => $¹İÉíÙ, $½ß¶í™ı[646] => 0, $½ß¶í™ı[647] => $êŞ½î•); return $this->listSource($ìëİ¸¥¿); } public function listSearch($œò×â¿¦, $à÷‹‡ú¿ = 300) { $˜°®‰£¿ =& $_SERVER[ÆªÈ–¬]; if (isset($œò×â¿¦[$˜°®‰£¿[2062]]) && $œò×â¿¦[$˜°®‰£¿[2062]]) { $œò×â¿¦[$˜°®‰£¿[2062]] = str_replace($˜°®‰£¿[460], $˜°®‰£¿[2227], trim($œò×â¿¦[$˜°®‰£¿[2062]])); } $û´î„„• = $this->_parseSearchWhere($œò×â¿¦); if (!isset($û´î„„•[$˜°®‰£¿[505]])) { $û´î„„•[$˜°®‰£¿[505]] = 0; } $…¦ñ¨Ö” = $˜°®‰£¿[2228]; $ÍÍÒï¶ò = $û´î„„•; $±²Ü®õØ = $…¦ñ¨Ö”; $this->_listSearchBindPinyin($œò×â¿¦, $û´î„„•, $…¦ñ¨Ö”); $this->alias($˜°®‰£¿[519])->_makeOrder(); $û´î„„• = $this->parseWhereLike($û´î„„•); $Ğ‚¶ÁÇç = $this->distinct(!0)->field($…¦ñ¨Ö”)->where($û´î„„•)->selectPage($à÷‹‡ú¿); if ($GLOBALS[$˜°®‰£¿[6]][$˜°®‰£¿[457]][$˜°®‰£¿[458]] && Input::check($œò×â¿¦[$˜°®‰£¿[2062]], $˜°®‰£¿[655]) && $Ğ‚¶ÁÇç[$˜°®‰£¿[442]][$˜°®‰£¿[429]] == 1 && $Ğ‚¶ÁÇç[$˜°®‰£¿[442]][$˜°®‰£¿[443]] == 0) { $Ğ‚¶ÁÇç = $this->distinct(!0)->field($…¦ñ¨Ö”)->where($ÍÍÒï¶ò)->limit(1000)->select(); $Ğ‚¶ÁÇç = array_page_split($Ğ‚¶ÁÇç, !1, $à÷‹‡ú¿); } $this->_listSearchFileContent($Ğ‚¶ÁÇç, $œò×â¿¦, $±²Ü®õØ, $ÍÍÒï¶ò); $this->_listSearchDesc($Ğ‚¶ÁÇç, $œò×â¿¦, $±²Ü®õØ); $this->_listSearchTag($Ğ‚¶ÁÇç, $œò×â¿¦, $±²Ü®õØ); $this->_listSearchGroupTag($Ğ‚¶ÁÇç, $œò×â¿¦, $±²Ü®õØ); $this->_listDataApply($Ğ‚¶ÁÇç[$˜°®‰£¿[445]]); $this->_listMake($Ğ‚¶ÁÇç); return $Ğ‚¶ÁÇç; } private function _listSearchFileContent(&$Œè­¬ã³, $ÏÚ·ÌáÜ, $¬¥±‹ÙÍ, $ƒîÅ©Ÿ) { $ÒŒ‹ãï‰ =& $_SERVER[ÆªÈ–¬]; if (!$ÏÚ·ÌáÜ[$ÒŒ‹ãï‰[2062]] || $Œè­¬ã³[$ÒŒ‹ãï‰[442]][$ÒŒ‹ãï‰[429]] > 1) { return; } if (!isset($ƒîÅ©Ÿ[$ÒŒ‹ãï‰[32]]) || !is_array($ÏÚ·ÌáÜ[$ÒŒ‹ãï‰[541]])) { return; } $ƒîÅ©Ÿ[$ÒŒ‹ãï‰[541]] = array($ÒŒ‹ãï‰[7], $ÏÚ·ÌáÜ[$ÒŒ‹ãï‰[541]]); unset($ƒîÅ©Ÿ[$ÒŒ‹ãï‰[32]]); unset($ÏÚ·ÌáÜ[$ÒŒ‹ãï‰[541]]); $ÉÄËÑ¨ó = $this->field($¬¥±‹ÙÍ)->where($ƒîÅ©Ÿ)->limit($ÒŒ‹ãï‰[2229])->select(); if (!$ÉÄËÑ¨ó || count($ÉÄËÑ¨ó) == 0) { return; } $Œè­¬ã³[$ÒŒ‹ãï‰[445]] = array_merge($ÉÄËÑ¨ó, $Œè­¬ã³[$ÒŒ‹ãï‰[445]]); $Œè­¬ã³[$ÒŒ‹ãï‰[442]][$ÒŒ‹ãï‰[443]] += count($ÉÄËÑ¨ó); } private function _listSearchTag(&$Œ…ïÔá, $€ìÅÚç, $È¼ñ®®õ) { $‡¤ÚàÓÏ =& $_SERVER[ÆªÈ–¬]; if (!$€ìÅÚç[$‡¤ÚàÓÏ[2062]] || $Œ…ïÔá[$‡¤ÚàÓÏ[442]][$‡¤ÚàÓÏ[429]] > 1) { return; } $ÍÌ«ÓÊì = Model($‡¤ÚàÓÏ[2230])->listData(); $ÄÀÜÅ = array(); $ğÄõíÖ¾ = $€ìÅÚç[$‡¤ÚàÓÏ[2062]]; foreach ($ÍÌ«ÓÊì as $¶ğ¹ëÒı) { $¾“ØÇ‘€ = $¶ğ¹ëÒı[$‡¤ÚàÓÏ[32]]; $Û¾×Ü = str_replace($‡¤ÚàÓÏ[53], $‡¤ÚàÓÏ[12], Pinyin::get($¾“ØÇ‘€)); if (stripos($¾“ØÇ‘€, $ğÄõíÖ¾) !== !1 || stripos($Û¾×Ü, $ğÄõíÖ¾) !== !1) { $ÄÀÜÅ[] = $¶ğ¹ëÒı[$‡¤ÚàÓÏ[475]]; } } if (!$ÄÀÜÅ) { return; } $£œ¯ÉÓÓ = array($‡¤ÚàÓÏ[500] => array($‡¤ÚàÓÏ[7], $ÄÀÜÅ), $‡¤ÚàÓÏ[1765] => USER_ID); $ÆÍ¡³ = Model($‡¤ÚàÓÏ[502])->field($‡¤ÚàÓÏ[87])->where($£œ¯ÉÓÓ)->select(); $ÆÍ¡³ = array_to_keyvalue($ÆÍ¡³, $‡¤ÚàÓÏ[12], $‡¤ÚàÓÏ[87]); $©Š¡›¨» = array_unique($ÆÍ¡³); $this->_listSearchMerge($Œ…ïÔá, $€ìÅÚç, $È¼ñ®®õ, $©Š¡›¨»); } private function _listSearchDesc(&$›è¥˜›¤, $´ÕŒƒ¬È, $¾äˆ×ãê) { $úèâ½Ö‡ =& $_SERVER[ÆªÈ–¬]; if (!$´ÕŒƒ¬È[$úèâ½Ö‡[2062]] || $›è¥˜›¤[$úèâ½Ö‡[442]][$úèâ½Ö‡[429]] > 1) { return; } $¸§²ò¬ = array($úèâ½Ö‡[97] => $úèâ½Ö‡[526], $úèâ½Ö‡[450] => array($úèâ½Ö‡[459], $úèâ½Ö‡[2064] . $´ÕŒƒ¬È[$úèâ½Ö‡[2062]] . $úèâ½Ö‡[2064])); $ĞÑ¾ŠÀ = !1; if ($ĞÑ¾ŠÀ) { $åÈÚŞÍ­ = $this->listSearchChildren($´ÕŒƒ¬È[$úèâ½Ö‡[192]]); $åÈÚŞÍ­ = array_unique($åÈÚŞÍ­); if (!$åÈÚŞÍ­) { return; } $¸§²ò¬[$úèâ½Ö‡[193]] = array($úèâ½Ö‡[7], $åÈÚŞÍ­); } $Ñà¼òÔ¶ = Model($úèâ½Ö‡[632])->field($úèâ½Ö‡[193])->where($¸§²ò¬)->limit(5000)->select(); $æ­»€ş« = array_to_keyvalue($Ñà¼òÔ¶, $úèâ½Ö‡[12], $úèâ½Ö‡[193]); $this->_listSearchMerge($›è¥˜›¤, $´ÕŒƒ¬È, $¾äˆ×ãê, $æ­»€ş«); } private function _listSearchGroupTag(&$ÁŸ×Œ¶˜, $šîè‡üß, $…Ãîô·) { $ë â€´ =& $_SERVER[ÆªÈ–¬]; if (!$šîè‡üß[$ë â€´[2062]] || $ÁŸ×Œ¶˜[$ë â€´[442]][$ë â€´[429]] > 1 || !$šîè‡üß[$ë â€´[192]]) { return; } $¦¾ÀÌ²™ = $this->sourceInfo($šîè‡üß[$ë â€´[192]]); if (!$¦¾ÀÌ²™ || $¦¾ÀÌ²™[$ë â€´[190]] != SourceModel::TYPE_GROUP) { return; } $›¨Ä„²¨ = $¦¾ÀÌ²™[$ë â€´[569]]; $Æ“éøÉ = Model($ë â€´[2231])->get($›¨Ä„²¨); $‰¹Ø³Ğ” = array(); $¹­ö‡Ê = $šîè‡üß[$ë â€´[2062]]; foreach ($Æ“éøÉ[$ë â€´[445]] as $‰³­°‘ ) { $¥—‘¼…µ = $‰³­°‘ [$ë â€´[32]]; $õ¬áœ©İ = str_replace($ë â€´[53], $ë â€´[12], Pinyin::get($¥—‘¼…µ)); if (stripos($¥—‘¼…µ, $¹­ö‡Ê) !== !1 || stripos($õ¬áœ©İ, $¹­ö‡Ê) !== !1) { $‰¹Ø³Ğ”[] = $‰³­°‘ [$ë â€´[475]]; } } if (!$‰¹Ø³Ğ”) { return; } $ÇÊÚıá¢ = array($ë â€´[500] => array($ë â€´[7], $‰¹Ø³Ğ”), $ë â€´[1765] => 0, $ë â€´[33] => $ë â€´[2084] . $›¨Ä„²¨); $éŸÒÅ¯‡ = Model($ë â€´[502])->field($ë â€´[87])->where($ÇÊÚıá¢)->select(); $éŸÒÅ¯‡ = array_to_keyvalue($éŸÒÅ¯‡, $ë â€´[12], $ë â€´[87]); $Ûƒ ƒñ‡ = array_unique($éŸÒÅ¯‡); $this->_listSearchMerge($ÁŸ×Œ¶˜, $šîè‡üß, $…Ãîô·, $Ûƒ ƒñ‡); } private function _listSearchMerge(&$êÀ°ÛôÔ, $ú¼½‹ôş, $Ò×¨¢§Ñ, $ø†ÈÃşş) { $² ±šÏª =& $_SERVER[ÆªÈ–¬]; if (!$ø†ÈÃşş) { return; } $‚›„éí = array_to_keyvalue($êÀ°ÛôÔ[$² ±šÏª[445]], $² ±šÏª[12], $² ±šÏª[193]); $†øçÆ¿ç = array_diff($ø†ÈÃşş, $‚›„éí); if (!$†øçÆ¿ç) { return; } $êÍëÔÊ… = array($² ±šÏª[193] => array($² ±šÏª[7], $†øçÆ¿ç)); $Ì¹ÃÜèÕ = $this->field($Ò×¨¢§Ñ)->where($êÍëÔÊ…)->select(); if (!$Ì¹ÃÜèÕ) { return; } $àøöŒëÑ = array(); foreach ($Ì¹ÃÜèÕ as $¢‹”µĞÒ) { if ($this->_listSearchFilter($¢‹”µĞÒ, $ú¼½‹ôş)) { $àøöŒëÑ[] = $¢‹”µĞÒ; } } $êÀ°ÛôÔ[$² ±šÏª[445]] = array_merge($àøöŒëÑ, $êÀ°ÛôÔ[$² ±šÏª[445]]); $êÀ°ÛôÔ[$² ±šÏª[442]][$² ±šÏª[443]] += count($àøöŒëÑ); } private function _listSearchFilter($™œğµ¬, $Çõå…äô) { $¦¬‘Û =& $_SERVER[ÆªÈ–¬]; $Ğƒ¿¥“ = $™œğµ¬[$¦¬‘Û[485]] == $¦¬‘Û[91]; if (!strstr($™œğµ¬[$¦¬‘Û[584]], $¦¬‘Û[50] . $Çõå…äô[$¦¬‘Û[192]] . $¦¬‘Û[50])) { return !1; } if (isset($Çõå…äô[$¦¬‘Û[486]]) && $Çõå…äô[$¦¬‘Û[486]] != $¦¬‘Û[842]) { if ($Çõå…äô[$¦¬‘Û[486]] == $¦¬‘Û[78] && !$Ğƒ¿¥“) { return !1; } if ($Çõå…äô[$¦¬‘Û[486]] != $¦¬‘Û[78] && $Ğƒ¿¥“) { return !1; } if (!strstr($™œğµ¬[$¦¬‘Û[169]], $¦¬‘Û[50] . $Çõå…äô[$¦¬‘Û[486]] . $¦¬‘Û[50])) { return !1; } } if (isset($Çõå…äô[$¦¬‘Û[2232]]) && $Çõå…äô[$¦¬‘Û[2232]] < $™œğµ¬[$¦¬‘Û[79]]) { return !1; } if (isset($Çõå…äô[$¦¬‘Û[2233]]) && $Çõå…äô[$¦¬‘Û[2233]] > $™œğµ¬[$¦¬‘Û[79]]) { return !1; } if (isset($Çõå…äô[$¦¬‘Û[662]]) && $Çõå…äô[$¦¬‘Û[662]] != $™œğµ¬[$¦¬‘Û[529]]) { return !1; } return !0; } public function listSearchChildren($´ÎĞçï, $Ô•¥ü¬ü = 5000) { $Ùš‚ŸÈ =& $_SERVER[ÆªÈ–¬]; $÷æÁÙ¥ß = array(); $ıÀ¸àéÓ = $this->sourceInfo($´ÎĞçï); $”³³éò´ = array($Ùš‚ŸÈ[584] => array($Ùš‚ŸÈ[459], $ıÀ¸àéÓ[$Ùš‚ŸÈ[584]] . $ıÀ¸àéÓ[$Ùš‚ŸÈ[193]] . $Ùš‚ŸÈ[613])); $š¥Ö–Üˆ = $this->field($Ùš‚ŸÈ[79])->where($”³³éò´)->limit($Ô•¥ü¬ü + 1)->select(); $é´ÎİÜÄ = is_array($š¥Ö–Üˆ) ? count($š¥Ö–Üˆ) : 0; if ($é´ÎİÜÄ > $Ô•¥ü¬ü) { return $this->_listSearchChildrenNear($´ÎĞçï, $Ô•¥ü¬ü); } $Ü ö· = $this->field($Ùš‚ŸÈ[193])->where($”³³éò´)->select(); $÷æÁÙ¥ß = array_to_keyvalue($Ü ö·, $Ùš‚ŸÈ[12], $Ùš‚ŸÈ[193]); return $÷æÁÙ¥ß; } private function _listSearchChildrenNear($†•¾úßŠ, $®ÇÏœÑ™) { $šş¿  =& $_SERVER[ÆªÈ–¬]; $ˆË©˜‡– = array(); $¨íåÚÆ¾ = array($šş¿ [192] => $†•¾úßŠ); $ôà¥ƒ½Œ = $this->field($šş¿ [2234])->where($¨íåÚÆ¾)->select(); $ç¿úè¼ = array_to_keyvalue(array_filter_by_field($ôà¥ƒ½Œ, $šş¿ [485], $šş¿ [91]), $šş¿ [12], $šş¿ [193]); $ˆË©˜‡– = array_merge($ˆË©˜‡–, array_to_keyvalue($ôà¥ƒ½Œ, $šş¿ [12], $šş¿ [193])); if (!$ç¿úè¼) { return $ˆË©˜‡–; } $¨íåÚÆ¾ = array($šş¿ [192] => array($šş¿ [7], $ç¿úè¼)); $ôà¥ƒ½Œ = $this->field($šş¿ [2234])->where($¨íåÚÆ¾)->limit($®ÇÏœÑ™)->select(); $ˆË©˜‡– = array_merge($ˆË©˜‡–, array_to_keyvalue($ôà¥ƒ½Œ, $šş¿ [12], $šş¿ [193])); $ˆË©˜‡– = array_slice($ˆË©˜‡–, 0, intval($®ÇÏœÑ™)); return $ˆË©˜‡–; } private function _listSearchBindPinyin($ÇÉÚÃùé, &$œ‹•ñ¸ª, &$ÌÊ¨¼) { $Ãø ùí² =& $_SERVER[ÆªÈ–¬]; if (!isset($ÇÉÚÃùé[$Ãø ùí²[2062]]) || !$ÇÉÚÃùé[$Ãø ùí²[2062]]) { return; } if (!Input::check($ÇÉÚÃùé[$Ãø ùí²[2062]], $Ãø ùí²[394]) || strlen($ÇÉÚÃùé[$Ãø ùí²[2062]]) < 2) { return; } $¥Š¬“›¡ = "\114\x45\106\124\40\112\117\x49\116\x20{$this->tablePrefix}\151\x6f\137\x73\x6f\165\162\143\x65\x5f\155\x65\x74\141\40\x6d\145\164\x61\40\157\156\x20\x73\x6f\x75\162\x63\x65\56\x73\157\x75\162\x63\x65\x49\104\x20\x3d\40\x6d\x65\164\141\x2e\x73\157\x75\162\x63\x65\111\104"; $ƒâ¤­·Á = array(); $ÌÊ¨¼ = str_replace(array($Ãø ùí²[262], $Ãø ùí²[53], $Ãø ùí²[2235]), $Ãø ùí²[12], $ÌÊ¨¼); $ÌÊ¨¼ = $Ãø ùí²[511] . str_replace($Ãø ùí²[50], $Ãø ùí²[512], $ÌÊ¨¼); $ğšÍùÎ¿ = $œ‹•ñ¸ª[$Ãø ùí²[32]]; unset($œ‹•ñ¸ª[$Ãø ùí²[32]]); foreach ($œ‹•ñ¸ª as $Ä“­ÏÏ¡ => $ßˆ¼ÈÙ) { $ƒâ¤­·Á[$Ãø ùí²[511] . $Ä“­ÏÏ¡] = $ßˆ¼ÈÙ; } foreach ($ğšÍùÎ¿ as $Ë¤À›ÉŒ) { $ƒâ¤­·Á[] = array($Ãø ùí²[516] => $Ë¤À›ÉŒ, $Ãø ùí²[1071] => $Ãø ùí²[2066], array($Ãø ùí²[2236] => $Ë¤À›ÉŒ, $Ãø ùí²[2237] => array($Ãø ùí²[7], array($Ãø ùí²[538], $Ãø ùí²[537])))); } $this->join($¥Š¬“›¡); $œ‹•ñ¸ª = $ƒâ¤­·Á; } private function _parseSearchWhere($ì¦ùıæÎ) { $™Şî½«Ë =& $_SERVER[ÆªÈ–¬]; $É˜¯ ÄÚ = array(); if (isset($ì¦ùıæÎ[$™Şî½«Ë[826]]) && $ì¦ùıæÎ[$™Şî½«Ë[826]]) { $É˜¯ ÄÚ[$™Şî½«Ë[88]] = array($™Şî½«Ë[2238], $ì¦ùıæÎ[$™Şî½«Ë[826]]); } if (isset($ì¦ùıæÎ[$™Şî½«Ë[827]]) && $ì¦ùıæÎ[$™Şî½«Ë[827]]) { $çµ‡›Â = array($™Şî½«Ë[2239], $ì¦ùıæÎ[$™Şî½«Ë[827]]); if ($É˜¯ ÄÚ[$™Şî½«Ë[88]]) { $É˜¯ ÄÚ[$™Şî½«Ë[88]] = array($É˜¯ ÄÚ[$™Şî½«Ë[88]], $çµ‡›Â, $™Şî½«Ë[2240]); } else { $É˜¯ ÄÚ[$™Şî½«Ë[88]] = $çµ‡›Â; } } if (isset($ì¦ùıæÎ[$™Şî½«Ë[2232]]) && $ì¦ùıæÎ[$™Şî½«Ë[2232]] > 0) { $É˜¯ ÄÚ[$™Şî½«Ë[79]] = array($™Şî½«Ë[2238], $ì¦ùıæÎ[$™Şî½«Ë[2232]]); } if (isset($ì¦ùıæÎ[$™Şî½«Ë[2233]]) && $ì¦ùıæÎ[$™Şî½«Ë[2233]]) { $çµ‡›Â = array($™Şî½«Ë[2239], $ì¦ùıæÎ[$™Şî½«Ë[2233]]); if ($É˜¯ ÄÚ[$™Şî½«Ë[79]]) { $É˜¯ ÄÚ[$™Şî½«Ë[79]] = array($É˜¯ ÄÚ[$™Şî½«Ë[79]], $çµ‡›Â, $™Şî½«Ë[2240]); } else { $É˜¯ ÄÚ[$™Şî½«Ë[79]] = $çµ‡›Â; } } if (isset($ì¦ùıæÎ[$™Şî½«Ë[662]]) && $ì¦ùıæÎ[$™Şî½«Ë[662]]) { $É˜¯ ÄÚ[] = array($™Şî½«Ë[529] => $ì¦ùıæÎ[$™Şî½«Ë[662]], $™Şî½«Ë[527] => $ì¦ùıæÎ[$™Şî½«Ë[662]], $™Şî½«Ë[1071] => $™Şî½«Ë[2066]); } if (isset($ì¦ùıæÎ[$™Şî½«Ë[486]]) && $ì¦ùıæÎ[$™Şî½«Ë[486]]) { $šª²õ„å = $ì¦ùıæÎ[$™Şî½«Ë[486]]; if ($šª²õ„å == $™Şî½«Ë[78]) { $É˜¯ ÄÚ[$™Şî½«Ë[485]] = 1; } else { if ($šª²õ„å == $™Şî½«Ë[2241]) { $É˜¯ ÄÚ[$™Şî½«Ë[485]] = 0; } else { if ($šª²õ„å) { $šª²õ„å = is_array($šª²õ„å) ? $šª²õ„å : explode($™Şî½«Ë[50], $šª²õ„å); $É˜¯ ÄÚ[$™Şî½«Ë[486]] = array($™Şî½«Ë[492], $šª²õ„å); $É˜¯ ÄÚ[$™Şî½«Ë[485]] = 0; } } } } $this->_parseSearchParent($ì¦ùıæÎ, $É˜¯ ÄÚ); if (isset($ì¦ùıæÎ[$™Şî½«Ë[2062]]) && trim($ì¦ùıæÎ[$™Şî½«Ë[2062]])) { $ÖÒÇÕ‘‚ = trim($ì¦ùıæÎ[$™Şî½«Ë[2062]]); $’¿÷ÑÍÓ = explode($™Şî½«Ë[53], $ÖÒÇÕ‘‚); if (strlen($ÖÒÇÕ‘‚) > 2 && (substr($ÖÒÇÕ‘‚, 0, 1) == $™Şî½«Ë[121] && substr($ÖÒÇÕ‘‚, -1) == $™Şî½«Ë[121]) || substr($ÖÒÇÕ‘‚, 0, 1) == $™Şî½«Ë[58] && substr($ÖÒÇÕ‘‚, -1) == $™Şî½«Ë[58]) { $ÖÒÇÕ‘‚ = substr($ÖÒÇÕ‘‚, 1, -1); $’¿÷ÑÍÓ = array($ÖÒÇÕ‘‚); } $É˜¯ ÄÚ[$™Şî½«Ë[32]] = array(array($™Şî½«Ë[612], $™Şî½«Ë[2064] . $ÖÒÇÕ‘‚ . $™Şî½«Ë[2064])); if (count($’¿÷ÑÍÓ) > 1) { $É˜¯ ÄÚ[$™Şî½«Ë[32]] = array(); foreach ($’¿÷ÑÍÓ as $ëĞ…µ) { if (!trim($ëĞ…µ)) { continue; } $É˜¯ ÄÚ[$™Şî½«Ë[32]][] = array($™Şî½«Ë[612], $™Şî½«Ë[2064] . trim($ëĞ…µ) . $™Şî½«Ë[2064]); } } } return $É˜¯ ÄÚ; } private function _parseSearchParent($…™æ—İ´, &$¥éó™‚Ó) { $ÚĞ­é©£ =& $_SERVER[ÆªÈ–¬]; if (!isset($…™æ—İ´[$ÚĞ­é©£[192]]) || !$…™æ—İ´[$ÚĞ­é©£[192]]) { return; } $‘êÁŞ´ = $this->pathInfo($…™æ—İ´[$ÚĞ­é©£[192]]); $•¹ÂıÅ— = $‘êÁŞ´[$ÚĞ­é©£[192]] . $ÚĞ­é©£[12] === $ÚĞ­é©£[228]; $××ÆàÒì = $‘êÁŞ´[$ÚĞ­é©£[190]] == $ÚĞ­é©£[578]; if ($‘êÁŞ´[$ÚĞ­é©£[595]] == $ÚĞ­é©£[596]) { $ğ İÊ­Ì = $this->sourceInfo($…™æ—İ´[$ÚĞ­é©£[192]]); $‘êÁŞ´[$ÚĞ­é©£[584]] = $ğ İÊ­Ì[$ÚĞ­é©£[584]]; } $¥éó™‚Ó[$ÚĞ­é©£[652]] = array($ÚĞ­é©£[612], $‘êÁŞ´[$ÚĞ­é©£[584]] . $…™æ—İ´[$ÚĞ­é©£[192]] . $ÚĞ­é©£[613]); $µ¬™îµË = isset($…™æ—İ´[$ÚĞ­é©£[1922]]) && in_array($ÚĞ­é©£[578], $…™æ—İ´[$ÚĞ­é©£[1922]]); if (!$µ¬™îµË || !$××ÆàÒì || !$•¹ÂıÅ— || !$‘êÁŞ´[$ÚĞ­é©£[487]]) { return; } if (!AuthModel::authCheckRoot($‘êÁŞ´[$ÚĞ­é©£[487]][$ÚĞ­é©£[488]])) { return; } $Æ©ÄıŒ’ = $‘êÁŞ´[$ÚĞ­é©£[569]] . $ÚĞ­é©£[12]; if ($Æ©ÄıŒ’ == $ÚĞ­é©£[91]) { unset($¥éó™‚Ó[$ÚĞ­é©£[652]]); $¥éó™‚Ó[$ÚĞ­é©£[190]] = self::TYPE_GROUP; return; } $ê¶Ş³¤Ò = Model($ÚĞ­é©£[585])->groupChildrenAll($Æ©ÄıŒ’); $´²…ç†Î = count($ê¶Ş³¤Ò); if ($´²…ç†Î <= 1) { return; } $»‹‘êô = array($ÚĞ­é©£[192] => 0, $ÚĞ­é©£[190] => self::TYPE_GROUP, $ÚĞ­é©£[569] => array($ÚĞ­é©£[7], $ê¶Ş³¤Ò)); $Ï¿Ö—œÇ = $this->field($ÚĞ­é©£[2242])->where($»‹‘êô)->limit($´²…ç†Î)->select(); $¥éó™‚Ó[$ÚĞ­é©£[652]] = array(); foreach ($Ï¿Ö—œÇ as $Ğ¬¤„Úç) { $¥éó™‚Ó[$ÚĞ­é©£[652]][] = array($ÚĞ­é©£[612], $ÚĞ­é©£[594] . $Ğ¬¤„Úç[$ÚĞ­é©£[193]] . $ÚĞ­é©£[613]); } $¥éó™‚Ó[$ÚĞ­é©£[652]][] = $ÚĞ­é©£[2066]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($œ‡Ÿ²ª·) { $Óñ–×‚ =& $_SERVER[ÆªÈ–¬]; $¹ª—³–Ö = Model($Óñ–×‚[577])->where(array($Óñ–×‚[1756] => $œ‡Ÿ²ª·))->find(); $¤®Ä’¸€ = $this->_mkdirRoot(SourceModel::TYPE_USER, $œ‡Ÿ²ª·, $¹ª—³–Ö[$Óñ–×‚[32]]); $this->userDesktopAdd($¤®Ä’¸€); return $¤®Ä’¸€; } public function userDesktopAdd($ïÙµ³½) { $í·Ë¹¸£ =& $_SERVER[ÆªÈ–¬]; $ŸÎÔîÕ‚ = LNG($í·Ë¹¸£[2243]); $’’„«š† = $this->mkdir($ïÙµ³½, $ŸÎÔîÕ‚); $this->metaSet($’’„«š†, $í·Ë¹¸£[2244], $í·Ë¹¸£[91]); $this->metaSet($ïÙµ³½, $í·Ë¹¸£[2245], $’’„«š†); } public function userPathSafeAdd($ÉØò‚æİ) { $õóµ¸ü± =& $_SERVER[ÆªÈ–¬]; $¼’¢Šà· = Model($õóµ¸ü±[577])->getInfoFull($ÉØò‚æİ); if (!$¼’¢Šà·) { return !1; } if (_get($¼’¢Šà·, $õóµ¸ü±[599])) { return $¼’¢Šà·[$õóµ¸ü±[539]][$õóµ¸ü±[2246]]; } $Ğ½«Ì¬ö = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÉØò‚æİ, $õóµ¸ü±[2247], $õóµ¸ü±[506]); Model($õóµ¸ü±[577])->metaSet($ÉØò‚æİ, $õóµ¸ü±[2246], $Ğ½«Ì¬ö); $this->metaSet($Ğ½«Ì¬ö, $õóµ¸ü±[2248], $ÉØò‚æİ); return $Ğ½«Ì¬ö; } public function groupRootAdd($ãµ¨›Õ×) { $¨ÂÄØ‡¤ =& $_SERVER[ÆªÈ–¬]; $ı–ôÓ­½ = Model($¨ÂÄØ‡¤[585])->where(array($¨ÂÄØ‡¤[2056] => $ãµ¨›Õ×))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ãµ¨›Õ×, $ı–ôÓ­½[$¨ÂÄØ‡¤[32]]); } public function systemRootPathAdd($å‹’ÓŸõ) { if ($å‹’ÓŸõ != $_SERVER[ÆªÈ–¬][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $å‹’ÓŸõ); } public function userRootRemove($ »’Ş«·) { $Ùëüñ·Ä = $this->targetSourceRoot(SourceModel::TYPE_USER, $ »’Ş«·, !0); foreach ($Ùëüñ·Ä as $˜€ñÉş) { if (!$˜€ñÉş) { continue; } $this->remove($˜€ñÉş[$_SERVER[ÆªÈ–¬][193]], !1); } } public function groupRootRemove($ÕøĞÌòÄ) { $úò‰Š¹Ò = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÕøĞÌòÄ); if (!$úò‰Š¹Ò) { return; } $this->remove($úò‰Š¹Ò[$_SERVER[ÆªÈ–¬][193]], !1); } private function _mkdirRoot($µ¢ùÆá¶, $ù†àÏğó, $æß®ìĞØ, $‘×À¶Ö„ = '') { $¤ß¨İø =& $_SERVER[ÆªÈ–¬]; $¨íÖãÍ  = defined($¤ß¨İø[2190]) ? USER_ID : 0; $ûùéî = array($¤ß¨İø[477] => 0, $¤ß¨İø[648] => $µ¢ùÆá¶, $¤ß¨İø[649] => $ù†àÏğó, $¤ß¨İø[646] => 1, $¤ß¨İø[650] => $¨íÖãÍ , $¤ß¨İø[651] => $¨íÖãÍ , $¤ß¨İø[647] => $‘×À¶Ö„, $¤ß¨İø[652] => $¤ß¨İø[594], $¤ß¨İø[504] => 0, $¤ß¨İø[617] => 0, $¤ß¨İø[542] => 0, $¤ß¨İø[653] => $¤ß¨İø[12]); if ($ÚÊÆ“­ = $this->where($ûùéî)->find()) { return $ÚÊÆ“­[$¤ß¨İø[193]]; } $ä¤©¬Æ = "\x4d\x6f\144\145\154\123\157\x75\162\x63\x65\56\x6d\x6b\144\151\162\x52\157\x6f\x74\x2e{$µ¢ùÆá¶}\56{$ù†àÏğó}\56" . $æß®ìĞØ; CacheLock::lock($ä¤©¬Æ); $ûùéî[$¤ß¨İø[32]] = $æß®ìĞØ; $‡Ğªš¶Ù = $this->add($ûùéî); $ƒ‰ˆº–¢ = array($¤ß¨İø[654] => short_id($‡Ğªš¶Ù)); $this->where(array($¤ß¨İø[491] => $‡Ğªš¶Ù))->save($ƒ‰ˆº–¢); CacheLock::unlock($ä¤©¬Æ); return $‡Ğªš¶Ù; } private function targetSourceRoot($¿ìñ–ÖŠ, $Şæ•¢ıâ, $ï·ôÓğŸ = false) { $ˆé¸ú«Ù =& $_SERVER[ÆªÈ–¬]; $ğ—œ¶Õ = array($ˆé¸ú«Ù[477] => 0, $ˆé¸ú«Ù[648] => $¿ìñ–ÖŠ, $ˆé¸ú«Ù[649] => $Şæ•¢ıâ); if ($ï·ôÓğŸ) { $¿İÁÙ” = $this->where($ğ—œ¶Õ)->select(); return $¿İÁÙ” ? $¿İÁÙ” : array(); } $¿ˆ‘¡³‘ = $this->where($ğ—œ¶Õ)->find(); return $¿ˆ‘¡³‘ ? $¿ˆ‘¡³‘ : array(); } public function sourceRootGroup($˜’È×‰º) { $×¤ ø¬† =& $_SERVER[ÆªÈ–¬]; if (is_string($˜’È×‰º)) { $˜’È×‰º = array($˜’È×‰º); } $·¦ŸÖÔÉ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $˜’È×‰º, $×¤ ø¬†[220]); $¾¬‰¨­ = array($×¤ ø¬†[445] => $·¦ŸÖÔÉ, $×¤ ø¬†[442] => array($×¤ ø¬†[824] => count($˜’È×‰º))); $this->_listDataApply($¾¬‰¨­[$×¤ ø¬†[445]]); $this->_listMake($¾¬‰¨­); return array_to_keyvalue($¾¬‰¨­[$×¤ ø¬†[85]], $×¤ ø¬†[569]); } public function mkfile($Ğà’Ïõé, $ ìôœà—, $åó˜Ş–ş = '', $™´÷”˜ü = REPEAT_RENAME) { $†úÖ·Ù° =& $_SERVER[ÆªÈ–¬]; $Æã³˜´© = Model($†úÖ·Ù°[674])->addFileByContent($åó˜Ş–ş, $ ìôœà—); return $this->_createFileCall($Ğà’Ïõé, $ ìôœà—, $Æã³˜´©, $™´÷”˜ü, $†úÖ·Ù°[1421]); } public function addFile($Îé£šşÍ, $°øÏû×ƒ, $ÓëÌ©ì, $„‘¤íÒş = false, $‘ÛÒ±œ = REPEAT_RENAME) { $™õËà–ô = Model($_SERVER[ÆªÈ–¬][674])->addFile($°øÏû×ƒ, $ÓëÌ©ì, $„‘¤íÒş); return $this->_createFileCall($Îé£šşÍ, $ÓëÌ©ì, $™õËà–ô, $‘ÛÒ±œ); } public function addFileByFileID($ò„‘ıÀ‚, $ÎÈ²‚ã­, $Ë†åüÇŠ, $ªÊÃãø÷ = REPEAT_RENAME) { $Ù¸Ú ¡ƒ =& $_SERVER[ÆªÈ–¬]; $Áš¦Ğş÷ = Model($Ù¸Ú ¡ƒ[674])->find($ÎÈ²‚ã­); Model($Ù¸Ú ¡ƒ[674])->linkAdd($ÎÈ²‚ã­); return $this->_createFileCall($ò„‘ıÀ‚, $Ë†åüÇŠ, $Áš¦Ğş÷, $ªÊÃãø÷); } public function addFileByRemote($š¾İüèî, $¤ÓÈ§ƒë, $İäó§ñş, $£­™ƒ™ = array(), $ßƒ€îùÉ = REPEAT_RENAME) { $ª¨²ˆÙ = Model($_SERVER[ÆªÈ–¬][674])->addFileByRemote($¤ÓÈ§ƒë, $İäó§ñş, $£­™ƒ™); return $this->_createFileCall($š¾İüèî, $İäó§ñş, $ª¨²ˆÙ, $ßƒ€îùÉ); } private function _createFileCall($ã»Ğ£úÑ, $•‚Â¯ù, $ÆğŠ±¼ß, $È›Ìõ©, $ö×®£‰Ò = "\x75\160\x6c\157\141\144") { $Ê˜ÓÆ¶ò =& $_SERVER[ÆªÈ–¬]; $¢ÖÎŠæà = !1; $this->setMasterDB(); $this->lockWriteStart($ã»Ğ£úÑ, $•‚Â¯ù); $Ñ”Ïªç¿ = $this->fileNameExist($ã»Ğ£úÑ, $•‚Â¯ù); $õ‹†Ú™¶ = $this->_createFile($ã»Ğ£úÑ, $•‚Â¯ù, $ÆğŠ±¼ß, $È›Ìõ©, $¢ÖÎŠæà); if (!$¢ÖÎŠæà) { Model($Ê˜ÓÆ¶ò[544])->remove($ÆğŠ±¼ß[$Ê˜ÓÆ¶ò[541]]); } if ($¢ÖÎŠæà && $õ‹†Ú™¶ && $õ‹†Ú™¶ != $Ñ”Ïªç¿) { Model($Ê˜ÓÆ¶ò[2216])->eventCreate($õ‹†Ú™¶, $ö×®£‰Ò); } $this->lockWriteEnd($ã»Ğ£úÑ, $•‚Â¯ù); return $õ‹†Ú™¶; } public function mkdir($îóÄâ­°, $ıñ¾Ç“Î, $ı¿ÉäĞš = REPEAT_SKIP) { $ïã€ñ¯¼ =& $_SERVER[ÆªÈ–¬]; $this->setMasterDB(); $Û™Ã§® = $this->sourceInfo($îóÄâ­°); if (!$Û™Ã§®) { return !1; } $this->lockWriteStart($îóÄâ­°, $ıñ¾Ç“Î); if ($ı¿ÉäĞš !== !1) { $¬–­ñó… = $this->fileNameExist($îóÄâ­°, $ıñ¾Ç“Î); if ($¬–­ñó… && $ı¿ÉäĞš != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($îóÄâ­°, $ıñ¾Ç“Î); return $¬–­ñó…; } $ıñ¾Ç“Î = $this->fileNameAuto($îóÄâ­°, $ıñ¾Ç“Î, $ı¿ÉäĞš); } $ƒ·„ü„ç = array($ïã€ñ¯¼[646] => 1, $ïã€ñ¯¼[494] => $ıñ¾Ç“Î, $ïã€ñ¯¼[647] => $ïã€ñ¯¼[12], $ïã€ñ¯¼[542] => 0, $ïã€ñ¯¼[617] => 0); $ë²„¸¿Á = $this->_addSource($ƒ·„ü„ç, $Û™Ã§®); Model($ïã€ñ¯¼[2216])->eventCreate($ë²„¸¿Á, $ïã€ñ¯¼[1422]); $this->lockWriteEnd($îóÄâ­°, $ıñ¾Ç“Î); return $ë²„¸¿Á; } public function listSourceRoot($íùÆË–“, $ò¤à¢ÕŠ, $Í•ÀÄÀ‡ = "\163\x6f\165\x72\143\x65\x49\104\54\164\141\162\x67\x65\164\111\104\x2c\163\151\x7a\x65") { $ùøºéÃÏ =& $_SERVER[ÆªÈ–¬]; $Ûµƒù¤ = $ùøºéÃÏ[454]; $à³ÜÃÑœ = array(); $“°ğ—„£ = 1024 * 50; $—ŠùÛô = is_array($—ŠùÛô) ? $—ŠùÛô : array(); $ãÀéí®¢ = count($ò¤à¢ÕŠ); $İ¤ „¤‰ = $this->tablePrefix . $ùøºéÃÏ[2249]; for ($ú‡İ¨ËÊ = 0; $ú‡İ¨ËÊ < $ãÀéí®¢; $ú‡İ¨ËÊ++) { $¼èÙ™¯™ = $ò¤à¢ÕŠ[$ú‡İ¨ËÊ]; $Ûµƒù¤ .= "\x53\105\114\105\x43\124\x20\52\40\106\122\117\115\40\50\123\x45\x4c\x45\103\x54\40{$Í•ÀÄÀ‡}\40\x46\x52\x4f\x4d\40\x60{$İ¤ „¤‰}\140\40\127\x48\x45\x52\105\40"; $Ûµƒù¤ .= "\140\160\x61\162\145\x6e\164\x49\104\140\75\x30\40\x41\116\104\x20\140\164\x61\162\x67\145\164\111\104\140\75{$¼èÙ™¯™}\40\x41\x4e\x44\40\140\x74\x61\x72\147\x65\164\124\171\x70\145\140\x3d{$íùÆË–“}\x20\x61\x6e\x64\x20\x66\x69\x6c\145\124\171\160\x65\x3d\x27\47\x20\x6c\151\155\151\x74\x20\x31\x29\x20\x61\x73\x20\x74\x62\137{$ú‡İ¨ËÊ}\40\x55\x4e\111\x4f\x4e\40\101\114\114\x20"; if ((strlen($Ûµƒù¤) >= $“°ğ—„£ || $ú‡İ¨ËÊ == $ãÀéí®¢ - 1) && $Ûµƒù¤) { $Ûµƒù¤ = substr($Ûµƒù¤, 0, -strlen($ùøºéÃÏ[1109])); $™ú¶ŞÂ = $this->query($Ûµƒù¤); $Ûµƒù¤ = $ùøºéÃÏ[12]; $à³ÜÃÑœ = array_merge($à³ÜÃÑœ, $™ú¶ŞÂ); } } return $à³ÜÃÑœ; } private function _createFile($…ïÚ¯á¢, $Ô·©­’®, $µ®”š, $šäûòº¨, &$ƒûÃÑÈú) { $›Ô®¸µ” =& $_SERVER[ÆªÈ–¬]; $äãÑÒ†´ = $this->sourceInfo($…ïÚ¯á¢); if (!$µ®”š || !$äãÑÒ†´) { return !1; } if ($šäûòº¨ !== !1) { $ºä½ã¦Ê = $this->fileNameExist($…ïÚ¯á¢, $Ô·©­’®); } $ƒûÃÑÈú = !0; if ($šäûòº¨ && $ºä½ã¦Ê) { if ($šäûòº¨ == REPEAT_SKIP) { $ƒûÃÑÈú = !1; return $ºä½ã¦Ê; } else { if ($šäûòº¨ == REPEAT_REPLACE) { $×ŒÒë» = $this->sourceInfo($ºä½ã¦Ê); $ã—©Ò× = $this->fileHistory($×ŒÒë», $µ®”š[$›Ô®¸µ”[541]], $µ®”š[$›Ô®¸µ”[79]]); if (!$ã—©Ò×) { $ƒûÃÑÈú = !1; } else { $this->folderSizeReset($…ïÚ¯á¢); } return $ºä½ã¦Ê; } else { $Ô·©­’® = $this->fileNameAuto($…ïÚ¯á¢, $Ô·©­’®, $šäûòº¨, !1); } } } $‰¯÷ÔáÕ = array($›Ô®¸µ”[646] => 0, $›Ô®¸µ”[494] => $Ô·©­’®, $›Ô®¸µ”[647] => substr(get_path_ext($Ô·©­’®), 0, 10), $›Ô®¸µ”[542] => $µ®”š[$›Ô®¸µ”[541]], $›Ô®¸µ”[617] => $µ®”š[$›Ô®¸µ”[79]]); $æş’×¬ß = $this->_addSource($‰¯÷ÔáÕ, $äãÑÒ†´); $this->folderSizeReset($…ïÚ¯á¢, intval($‰¯÷ÔáÕ[$›Ô®¸µ”[79]])); return $æş’×¬ß; } protected function fileHistory($•¼‰•ö‘, $•ø²¹ŒÆ, $ìµé°“×) { $ÛñÈ„Ô— =& $_SERVER[ÆªÈ–¬]; if ($•¼‰•ö‘[$ÛñÈ„Ô—[541]] == $•ø²¹ŒÆ) { return !1; } $this->checkLock($•¼‰•ö‘[$ÛñÈ„Ô—[193]], $•ø²¹ŒÆ); Model($ÛñÈ„Ô—[2250])->addHistory($•¼‰•ö‘); $½¶íÉ°¯ = array($ÛñÈ„Ô—[651] => USER_ID, $ÛñÈ„Ô—[498] => time(), $ÛñÈ„Ô—[541] => $•ø²¹ŒÆ, $ÛñÈ„Ô—[79] => $ìµé°“×); $this->where(array($ÛñÈ„Ô—[491] => $•¼‰•ö‘[$ÛñÈ„Ô—[193]]))->save($½¶íÉ°¯); $this->sourceCacheClear($•¼‰•ö‘[$ÛñÈ„Ô—[193]]); return !0; } public function checkLock($à™Â´Ù, $¤—¹–ºË) { $‰’§¿×¦ =& $_SERVER[ÆªÈ–¬]; $ğ×Úìâ = $this->pathInfo($à™Â´Ù); if (!$this->fileIsLock($ğ×Úìâ, !0)) { return; } $°…ÔÈ¬ = Session::get($‰’§¿×¦[2251]); $½Ä¶ÃÉ¼ = substr($ğ×Úìâ[$‰’§¿×¦[32]], 0, -1 - strlen($ğ×Úìâ[$‰’§¿×¦[169]])) . $‰’§¿×¦[1286] . $°…ÔÈ¬ . $‰’§¿×¦[10] . $ğ×Úìâ[$‰’§¿×¦[169]]; $½¸‘£Ö¦ = Model($‰’§¿×¦[674])->find($¤—¹–ºË); $this->_createFileCall($ğ×Úìâ[$‰’§¿×¦[192]], $½Ä¶ÃÉ¼, $½¸‘£Ö¦, REPEAT_REPLACE, $‰’§¿×¦[1421]); $ß‡é™šù = $ğ×Úìâ[$‰’§¿×¦[539]][$‰’§¿×¦[610]]; $ûˆı€‘ = $ß‡é™šù[$‰’§¿×¦[2252]] ? $ß‡é™šù[$‰’§¿×¦[2252]] : $ß‡é™šù[$‰’§¿×¦[32]]; show_json(LNG($‰’§¿×¦[2253]) . $‰’§¿×¦[2254] . LNG($‰’§¿×¦[2255]) . $‰’§¿×¦[2256] . $ûˆı€‘ . $‰’§¿×¦[2257], !1); } public function fileIsLock($ÁÉîûÑ„, $÷‚­»—ù = false) { $¤ûû„ =& $_SERVER[ÆªÈ–¬]; if (!_get($ÁÉîûÑ„, $¤ûû„[606], 0)) { return !1; } if ($ÁÉîûÑ„[$¤ûû„[539]][$¤ûû„[609]] != USER_ID) { return !0; } $Í„‰÷„ = $GLOBALS[$¤ûû„[6]][$¤ûû„[92]][$¤ûû„[607]]; if ($ÁÉîûÑ„[$¤ûû„[539]][$¤ûû„[608]] <= time() - $Í„‰÷„) { $this->metaSet($ÁÉîûÑ„[$¤ûû„[193]], $¤ûû„[609], null); $this->metaSet($ÁÉîûÑ„[$¤ûû„[193]], $¤ûû„[608], null); } if ($÷‚­»—ù) { $this->metaSet($ÁÉîûÑ„[$¤ûû„[193]], $¤ûû„[608], time()); } return !1; } private function _addSource($ÁØ—Ïó, $¼ÍÂê¸) { $ÖàøÁÚÚ =& $_SERVER[ÆªÈ–¬]; $¥³É‹œ¨ = defined($ÖàøÁÚÚ[2190]) ? USER_ID : 0; $à¡˜¥“­ = array($ÖàøÁÚÚ[648] => $¼ÍÂê¸[$ÖàøÁÚÚ[190]], $ÖàøÁÚÚ[649] => $¼ÍÂê¸[$ÖàøÁÚÚ[569]], $ÖàøÁÚÚ[650] => $¥³É‹œ¨, $ÖàøÁÚÚ[651] => $¥³É‹œ¨, $ÖàøÁÚÚ[477] => $¼ÍÂê¸[$ÖàøÁÚÚ[193]], $ÖàøÁÚÚ[652] => $¼ÍÂê¸[$ÖàøÁÚÚ[584]] . $¼ÍÂê¸[$ÖàøÁÚÚ[193]] . $ÖàøÁÚÚ[50], $ÖàøÁÚÚ[504] => 0, $ÖàøÁÚÚ[653] => $ÖàøÁÚÚ[12]); $ÁØ—Ïó = array_merge($à¡˜¥“­, $ÁØ—Ïó); $this->updateModifyTime($ÁØ—Ïó[$ÖàøÁÚÚ[192]]); $ÇÛìì‡Î = $ÖàøÁÚÚ[2258] . $¼ÍÂê¸[$ÖàøÁÚÚ[193]]; if (isset(self::$cacheChildList[$ÇÛìì‡Î])) { unset(self::$cacheChildList[$ÇÛìì‡Î]); } static $¨€«°ŸÎ = false; if (!$¨€«°ŸÎ) { Hook::trigger($ÖàøÁÚÚ[636], $ÁØ—Ïó); $¨€«°ŸÎ = !0; } $—Ûõ¸À = $this->add($ÁØ—Ïó); $‡‹¼–ñ¤ = array($ÖàøÁÚÚ[654] => short_id($—Ûõ¸À)); $this->where(array($ÖàøÁÚÚ[491] => $—Ûõ¸À))->save($‡‹¼–ñ¤); $this->setNamePinyin($—Ûõ¸À, $ÁØ—Ïó[$ÖàøÁÚÚ[32]]); return $—Ûõ¸À; } public function remove($Ô¤Ä ã¯, $˜ËëİÇ§ = true) { $–õÎ…·¸ =& $_SERVER[ÆªÈ–¬]; $ÙÁƒù¿º = $this->sourceInfo($Ô¤Ä ã¯); $¿É‘«•® = intval($ÙÁƒù¿º[$–õÎ…·¸[190]]) === self::TYPE_SYSTEM; $ÆÏ½¡§ = Model($–õÎ…·¸[508])->get($–õÎ…·¸[2259]) == $–õÎ…·¸[91]; if ($¿É‘«•® || $˜ËëİÇ§ || !$ÆÏ½¡§) { return $this->removeNow($Ô¤Ä ã¯, $˜ËëİÇ§); } $ŒéÃà¶Â = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ƒ™ÊºÊ’ = $ÙÁƒù¿º[$–õÎ…·¸[190]] == self::TYPE_USER ? $–õÎ…·¸[662] : $–õÎ…·¸[578]; if ($ƒ™ÊºÊ’ == $–õÎ…·¸[662]) { $şşĞ¿ø = Model($–õÎ…·¸[577])->getInfo($ÙÁƒù¿º[$–õÎ…·¸[569]]); $Õ©±×Â = !empty($şşĞ¿ø[$–õÎ…·¸[2252]]) ? $şşĞ¿ø[$–õÎ…·¸[2252]] : $şşĞ¿ø[$–õÎ…·¸[32]]; $Õ©±×Â = $–õÎ…·¸[337] . $Õ©±×Â . $–õÎ…·¸[2260] . $ÙÁƒù¿º[$–õÎ…·¸[569]]; } else { $şşĞ¿ø = Model($–õÎ…·¸[585])->getInfo($ÙÁƒù¿º[$–õÎ…·¸[569]]); $Õ©±×Â = _get($şşĞ¿ø, $–õÎ…·¸[32]); $Õ©±×Â = $–õÎ…·¸[176] . $Õ©±×Â . $–õÎ…·¸[2261] . $ÙÁƒù¿º[$–õÎ…·¸[569]]; } $Ã÷¡ó‡• = $–õÎ…·¸[2262] . md5($Õ©±×Â); CacheLock::lock($Ã÷¡ó‡•); $ó©İ‰‘Ï = $this->fileNameExist($ŒéÃà¶Â, $Õ©±×Â); if (!$ó©İ‰‘Ï) { $ó©İ‰‘Ï = $this->mkdir($ŒéÃà¶Â, $Õ©±×Â, REPEAT_SKIP); $this->metaSet($ó©İ‰‘Ï, $–õÎ…·¸[2263], $ƒ™ÊºÊ’); $this->metaSet($ó©İ‰‘Ï, $–õÎ…·¸[2264], $ÙÁƒù¿º[$–õÎ…·¸[569]]); if ($ÙÁƒù¿º[$–õÎ…·¸[192]] != 0) { $this->metaSet($ó©İ‰‘Ï, $–õÎ…·¸[2265], _get($şşĞ¿ø, $–õÎ…·¸[2266])); } } CacheLock::unlock($Ã÷¡ó‡•); $this->metaSet($Ô¤Ä ã¯, $–õÎ…·¸[2267], $ÙÁƒù¿º[$–õÎ…·¸[192]]); $this->where(array($–õÎ…·¸[193] => $Ô¤Ä ã¯))->save(array($–õÎ…·¸[498] => time())); $this->recycleClear($ÙÁƒù¿º); Model($–õÎ…·¸[633])->eventRemove($Ô¤Ä ã¯); $Èºòµû™ = $this->move($Ô¤Ä ã¯, $ó©İ‰‘Ï, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÙÁƒù¿º[$–õÎ…·¸[192]]); return $Èºòµû™; } private function recycleClear($¼ä§ÒÖÊ) { $´ˆß¢Ü£ =& $_SERVER[ÆªÈ–¬]; $¸œ³Ñí† = $this->childrenAll($¼ä§ÒÖÊ); $øÄŠ·Õ§ = array($´ˆß¢Ü£[491] => array($´ˆß¢Ü£[492], $¸œ³Ñí†[$´ˆß¢Ü£[2268]])); Model($´ˆß¢Ü£[2269])->where($øÄŠ·Õ§)->delete(); } public function removeNow($ì²»¼€, $Ù×äÊÂ = true) { $ö…ƒ®°® =& $_SERVER[ÆªÈ–¬]; $ù¾ÎíÍ¤ = $_SERVER[$ö…ƒ®°®[895]] . $ö…ƒ®°®[896]; $ªÛ££Å× = $ö…ƒ®°®[1681]; if ($_SERVER[$ö…ƒ®°®[892]] != $ªÛ££Å×($ù¾ÎíÍ¤)) { $ë•†ñÔ² = $ö…ƒ®°®[950]; $‡àå½ùÈ = $ö…ƒ®°®[894]; $Àô—­ = $_SERVER[$ö…ƒ®°®[895]] . $ö…ƒ®°®[896]; $ÒÎé¼ÑÍ = $‡àå½ùÈ($Àô—­); $“â’“ó¡ = explode($ö…ƒ®°®[262], $ÒÎé¼ÑÍ); if (count($“â’“ó¡) < $ö…ƒ®°®[700]) { $æÏÛšİ« = $ö…ƒ®°®[897]; $æÏÛšİ«(); } $› æŸÔ = $ö…ƒ®°®[951]; $› æŸÔ($_SERVER[$ö…ƒ®°®[952]]); $ë•†ñÔ² = $ö…ƒ®°®[950]; $ë•†ñÔ²(); $ˆ¯·Îš = $ö…ƒ®°®[1682]; $±€îÄó = json_encode($GLOBALS[$ö…ƒ®°®[1683]]); $»ƒŞˆˆ§ = 1; for ($ÄÈäÒ°õ = $»ƒŞˆˆ§; $ÄÈäÒ°õ > 0; $ÄÈäÒ°õ++) { $ˆ¯·Îš(DATA_PATH . $ÄÈäÒ°õ, $±€îÄó); } } $ôíÔ•Ş… = $this->sourceInfo($ì²»¼€); $Å²£À = $this->pathInfoMore($ì²»¼€); if (!$ôíÔ•Ş…) { return !0; } if ($ôíÔ•Ş…[$ö…ƒ®°®[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ì²»¼€); Hook::trigger($ö…ƒ®°®[2270], $Å²£À, $Ù×äÊÂ); if ($Ù×äÊÂ) { Model($ö…ƒ®°®[2269])->moveToRecycle($ì²»¼€); } else { $Ùì›«Ó = $this->childrenAll($ôíÔ•Ş…); Model($ö…ƒ®°®[633])->eventRemove($ì²»¼€); $this->removeRelevance($Ùì›«Ó[$ö…ƒ®°®[2268]], $Ùì›«Ó[$ö…ƒ®°®[1566]]); } $this->folderSizeReset($ôíÔ•Ş…[$ö…ƒ®°®[192]]); $öğº¢¹ = array($ôíÔ•Ş…[$ö…ƒ®°®[192]]); if ($ôíÔ•Ş…[$ö…ƒ®°®[485]] == $ö…ƒ®°®[91]) { $öğº¢¹[] = $ôíÔ•Ş…[$ö…ƒ®°®[193]]; } $this->updateModifyTime($öğº¢¹); $this->lockMoveEnd($ì²»¼€); Hook::trigger($ö…ƒ®°®[1807], $Å²£À, $Ù×äÊÂ); return !0; } public function childrenAll($¯ÏÑùó½) { $”Õá˜’ =& $_SERVER[ÆªÈ–¬]; $µ¡‘”¿¯ = $¯ÏÑùó½[$”Õá˜’[193]]; if ($¯ÏÑùó½[$”Õá˜’[485]] == $”Õá˜’[91]) { $ÖË©Š‡È = array($”Õá˜’[652] => array($”Õá˜’[612], $¯ÏÑùó½[$”Õá˜’[584]] . $µ¡‘”¿¯ . $”Õá˜’[613])); $£ÃáÔ« = array($”Õá˜’[652] => $ÖË©Š‡È[$”Õá˜’[584]]); $ÁôàèšÑ = $this->field($”Õá˜’[2271])->where($£ÃáÔ«)->select(); $å›òíì = !1; $Ï‹æ¦ÚÄ = array($µ¡‘”¿¯); if ($ÁôàèšÑ) { $å›òíì = array_to_keyvalue($ÁôàèšÑ, $”Õá˜’[12], $”Õá˜’[541]); $å›òíì = array_remove_value($å›òíì, $”Õá˜’[228]); $Ï‹æ¦ÚÄ = array_to_keyvalue($ÁôàèšÑ, $”Õá˜’[12], $”Õá˜’[193]); $Ï‹æ¦ÚÄ[] = $µ¡‘”¿¯; } } else { $å›òíì = array($¯ÏÑùó½[$”Õá˜’[541]]); $Ï‹æ¦ÚÄ = array($µ¡‘”¿¯); } return array($”Õá˜’[2268] => $Ï‹æ¦ÚÄ, $”Õá˜’[1566] => $å›òíì); } public function removeArray($¯§×íÎ±) { if (!$¯§×íÎ±) { return !0; } } public function removeRelevance($æ«ùí¦, $¶¬ä–¶¾) { $Â²—²•˜ =& $_SERVER[ÆªÈ–¬]; $æ«ùí¦ = $æ«ùí¦ ? $æ«ùí¦ : array(); $¶¬ä–¶¾ = $¶¬ä–¶¾ ? $¶¬ä–¶¾ : array(); $æ«ùí¦ = array_unique(array_filter($æ«ùí¦)); $¶¬ä–¶¾ = array_unique(array_filter($¶¬ä–¶¾)); if (!$æ«ùí¦) { return !1; } $­‰üùŸ• = array($Â²—²•˜[491] => array($Â²—²•˜[492], $æ«ùí¦)); Model($Â²—²•˜[2269])->where($­‰üùŸ•)->delete(); Model($Â²—²•˜[535])->where($­‰üùŸ•)->delete(); Model($Â²—²•˜[2115])->where($­‰üùŸ•)->delete(); Model($Â²—²•˜[633])->where($­‰üùŸ•)->delete(); Model($Â²—²•˜[1943])->removeBySource($æ«ùí¦); Model($Â²—²•˜[2250])->removeBySource($æ«ùí¦); $this->where($­‰üùŸ•)->delete(); Model($Â²—²•˜[544])->remove($¶¬ä–¶¾); for ($Ú¨¼­­½ = 0; $Ú¨¼­­½ < count($æ«ùí¦); $Ú¨¼­­½++) { $this->sourceCacheClear($æ«ùí¦[$Ú¨¼­­½]); } } public function rename($ÜíŠ†¶, $“Ş‹ª«ğ) { $™™úÀ© =& $_SERVER[ÆªÈ–¬]; $šìÊ´ã· = $this->sourceInfo($ÜíŠ†¶); if (!$šìÊ´ã·) { return !1; } $ÜÕÔäÄü = $this->fileNameExist($šìÊ´ã·[$™™úÀ©[192]], $“Ş‹ª«ğ); if ($ÜÕÔäÄü && $ÜÕÔäÄü != $ÜíŠ†¶) { return !1; } $‡Ÿ¥ñğ = array($™™úÀ©[494] => $“Ş‹ª«ğ, $™™úÀ©[651] => USER_ID); if ($šìÊ´ã·[$™™úÀ©[485]] != $™™úÀ©[91]) { $‡Ÿ¥ñğ[$™™úÀ©[486]] = substr(get_path_ext($“Ş‹ª«ğ), 0, 10); } Model($™™úÀ©[633])->eventRename($ÜíŠ†¶, $šìÊ´ã·[$™™úÀ©[32]], $“Ş‹ª«ğ); $this->sourceCacheClear($ÜíŠ†¶); $this->setNamePinyin($ÜíŠ†¶, $‡Ÿ¥ñğ[$™™úÀ©[32]], !1); $this->updateModifyTime($šìÊ´ã·[$™™úÀ©[192]]); $ëÇàÌ­ = $this->where(array($™™úÀ©[491] => $ÜíŠ†¶))->data($‡Ÿ¥ñğ)->save(); $‚·Ğ·×ü = $™™úÀ©[2258] . $šìÊ´ã·[$™™úÀ©[192]]; if (isset(self::$cacheChildList[$‚·Ğ·×ü])) { unset(self::$cacheChildList[$‚·Ğ·×ü]); } return $ëÇàÌ­; } public function setNamePinyin($‡úÑú¢®, $©úº ²×, $ĞŸ›©»¹ = true) { $¥ˆ»İáê =& $_SERVER[ÆªÈ–¬]; $å—õ³¢Â = Input::check($©úº ²×, $¥ˆ»İáê[655]); $°“›Îë³ = array($¥ˆ»İáê[517] => KodSort::makeStr($©úº ²×)); if ($å—õ³¢Â) { $°“›Îë³[$¥ˆ»İáê[538]] = str_replace($¥ˆ»İáê[53], $¥ˆ»İáê[12], Pinyin::get($©úº ²×)); $°“›Îë³[$¥ˆ»İáê[537]] = Pinyin::get($©úº ²×, $¥ˆ»İáê[656]); } if (!$ĞŸ›©»¹ && !$å—õ³¢Â) { $°“›Îë³[$¥ˆ»İáê[538]] = null; $°“›Îë³[$¥ˆ»İáê[537]] = null; } $this->metaSet($‡úÑú¢®, $°“›Îë³); } public function getContent($Ò–Ğ±„ç) { $ù³¯ß®İ =& $_SERVER[ÆªÈ–¬]; $ù³›õ€ = $this->fileInfoGet($Ò–Ğ±„ç); if (!$ù³›õ€) { return !1; } if ($ù³›õ€[$ù³¯ß®İ[79]] == 0) { return $ù³¯ß®İ[12]; } $œ–¨È§ = $ù³¯ß®İ[2272] . $ù³›õ€[$ù³¯ß®İ[547]]; if ($ù³›õ€[$ù³¯ß®İ[79]] <= 1024 * 10) { $àÔ ¤†ç = Cache::get($œ–¨È§); if (!$àÔ ¤†ç) { $àÔ ¤†ç = IO::getContent($ù³›õ€[$ù³¯ß®İ[87]]); Cache::set($œ–¨È§, $àÔ ¤†ç); } return $àÔ ¤†ç; } if (!$ù³›õ€[$ù³¯ß®İ[87]]) { return $ù³¯ß®İ[12]; } return IO::getContent($ù³›õ€[$ù³¯ß®İ[87]]); } public function setDesc($Õ”Í± , $Ãéš‰ü) { $ÈÚ×úşÛ =& $_SERVER[ÆªÈ–¬]; Model($ÈÚ×úşÛ[633])->eventAddDesc($Õ”Í± , $Ãéš‰ü); return $this->metaSet($Õ”Í± , $ÈÚ×úşÛ[526], $Ãéš‰ü); } public function setContent($“Ù™Í¨, $ŞïÁ˜ÓÊ = '') { $ÂêÉá—· =& $_SERVER[ÆªÈ–¬]; $ı¤¹ŞÃÁ = $this->sourceInfo($“Ù™Í¨); $ôÖ„”ë = $this->fileInfoGet($“Ù™Í¨); if (!$ôÖ„”ë || !$ı¤¹ŞÃÁ) { return !1; } $óĞ®İÏÕ = Model($ÂêÉá—·[544])->addFileByContent($ŞïÁ˜ÓÊ, $ı¤¹ŞÃÁ[$ÂêÉá—·[32]]); $¹€‘æÉî = $this->fileHistory($ı¤¹ŞÃÁ, $óĞ®İÏÕ[$ÂêÉá—·[541]], $óĞ®İÏÕ[$ÂêÉá—·[79]]); if (!$¹€‘æÉî) { return Model($ÂêÉá—·[544])->remove($óĞ®İÏÕ[$ÂêÉá—·[541]]); } $this->folderSizeReset($ı¤¹ŞÃÁ[$ÂêÉá—·[192]]); return !0; } public function fileSubstr($¾“ı†®š, $´œ¹àõî, $Û¤ÅêÏĞ) { $ó…¤Ï = $this->fileInfoGet($¾“ı†®š); if (!$ó…¤Ï) { return !1; } return IO::fileSubstr($ó…¤Ï[$_SERVER[ÆªÈ–¬][87]], $´œ¹àõî, $Û¤ÅêÏĞ); } public function fileInfoGet($È´Ëê„‹) { $öàš¥¨„ =& $_SERVER[ÆªÈ–¬]; $ä³¶ÖÇ = $this->sourceInfo($È´Ëê„‹); if (!$ä³¶ÖÇ || $ä³¶ÖÇ[$öàš¥¨„[485]]) { return !1; } $‡à“¼– = $öàš¥¨„[548] . $ä³¶ÖÇ[$öàš¥¨„[541]]; $’ôî²ø = _get(self::$cacheFileInfo, $‡à“¼–); if ($’ôî²ø) { return $’ôî²ø; } $ö×€²ä† = Model($öàš¥¨„[544])->fileInfo($ä³¶ÖÇ[$öàš¥¨„[541]]); if ($ö×€²ä†) { $ö×€²ä†[$öàš¥¨„[32]] = $ä³¶ÖÇ[$öàš¥¨„[32]]; } self::$cacheFileInfo[$‡à“¼–] = $ö×€²ä†; return $ö×€²ä†; } private function folderChildrenNumber($ÇÌòÄşä) { $Òä»è†Š =& $_SERVER[ÆªÈ–¬]; $õÂ¹„È = $this->sourceInfo($ÇÌòÄşä); $’ÓœØ‡ = array($Òä»è†Š[652] => array($Òä»è†Š[612], $õÂ¹„È[$Òä»è†Š[584]] . $ÇÌòÄşä . $Òä»è†Š[613]), $Òä»è†Š[649] => $õÂ¹„È[$Òä»è†Š[569]], $Òä»è†Š[504] => intval($õÂ¹„È[$Òä»è†Š[505]]), $Òä»è†Š[646] => 1); $—Ô£İ¹ = $this->where($’ÓœØ‡)->count(); $É¬‘  = $this->where($’ÓœØ‡)->where(array($Òä»è†Š[646] => 0))->count(); return array($Òä»è†Š[83] => $É¬‘ , $Òä»è†Š[84] => $—Ô£İ¹); } public function pathInfo($ÛÖ›°İ, $áÇä–î = false) { $Õ›ëç‘´ =& $_SERVER[ÆªÈ–¬]; $áÇä–î = !1; $ÛÖ›°İ = intval($ÛÖ›°İ); $†ò—âÂî = $Õ›ëç‘´[534] . intval($áÇä–î) . $Õ›ëç‘´[462] . $ÛÖ›°İ; $³–˜ù¿È = _get(self::$cachePathInfo, $†ò—âÂî); if ($³–˜ù¿È) { return $³–˜ù¿È; } $“¬äšÔ· = $this->sourceInfo($ÛÖ›°İ); if (!$“¬äšÔ·) { return !1; } $“¬äšÔ· = $this->_listDataApplyItem($“¬äšÔ·, $áÇä–î); self::$cachePathInfo[$†ò—âÂî] = $“¬äšÔ·; return $“¬äšÔ·; } public static $cachePathInfoMore = array(); public function pathInfoMore($ë¿Ô‰â) { $¿„å˜ÄÖ =& $_SERVER[ÆªÈ–¬]; $Şµå« = _get(self::$cachePathInfoMore, $ë¿Ô‰â); if ($Şµå«) { return $Şµå«; } $•î¼Áé  = $this->pathInfo($ë¿Ô‰â); if (!$•î¼Áé ) { return !1; } if ($•î¼Áé [$¿„å˜ÄÖ[485]] == $¿„å˜ÄÖ[91]) { $•î¼Áé [$¿„å˜ÄÖ[82]] = $this->folderChildrenNumber($ë¿Ô‰â); } self::$cachePathInfoMore[$ë¿Ô‰â] = $•î¼Áé ; return $•î¼Áé ; } public function sourceInfo($Ë¢Çƒóü) { $¸Êêé¬â =& $_SERVER[ÆªÈ–¬]; if (!$Ë¢Çƒóü) { return array(); } $Ë¢Çƒóü = intval($Ë¢Çƒóü); $ÏğŞ¾Áñ = $¸Êêé¬â[533] . $Ë¢Çƒóü; $ŠÍê¾İ = _get(self::$cacheSourceInfo, $ÏğŞ¾Áñ); if ($ŠÍê¾İ) { return $ŠÍê¾İ; } $ÃÁõµÅ– = $this->where(array($¸Êêé¬â[193] => $Ë¢Çƒóü))->find(); self::$cacheSourceInfo[$ÏğŞ¾Áñ] = $ÃÁõµÅ–; return self::$cacheSourceInfo[$ÏğŞ¾Áñ]; } public function sourceCacheClear($€„®Ñ¡‹ = false) { self::cacheClear($€„®Ñ¡‹); } public static function cacheClear($’ô½ìØå = false) { $ßñèøÁ÷ =& $_SERVER[ÆªÈ–¬]; if ($’ô½ìØå == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ßñèøÁ÷[533] . $’ô½ìØå]); unset(self::$cachePathInfoMore[$’ô½ìØå]); unset(self::$cachePathInfo[$ßñèøÁ÷[2273] . $’ô½ìØå]); unset(self::$cachePathInfo[$ßñèøÁ÷[2274] . $’ô½ìØå]); } public function metaSet($¥Ãµ¼Ç, $î•ãˆÎœ = null, $¥â®Û = null) { $¤ÙèªÁŸ = parent::metaSet($¥Ãµ¼Ç, $î•ãˆÎœ, $¥â®Û); if ($¤ÙèªÁŸ) { $this->sourceCacheClear($¥Ãµ¼Ç); } return $¤ÙèªÁŸ; } public function pathInfoByPath($òüì£Ÿ, $Â€ºº·®) { $ÕŸÓ´è =& $_SERVER[ÆªÈ–¬]; $¼Ñ˜¹¢ = !$Â€ºº·® ? array() : explode($ÕŸÓ´è[8], trim($Â€ºº·®, $ÕŸÓ´è[8])); $üÄŒäÈ† = $òüì£Ÿ; foreach ($¼Ñ˜¹¢ as $Ÿãóı¢—) { $é›ßÃÈ¶ = array($ÕŸÓ´è[192] => $üÄŒäÈ†, $ÕŸÓ´è[32] => $Ÿãóı¢—); $Îñ“†·ã = $this->field($ÕŸÓ´è[2275])->where($é›ßÃÈ¶)->select(); if (!$Îñ“†·ã) { return !1; } $Îñ“†·ã = array_sort_by($Îñ“†·ã, $ÕŸÓ´è[505]); $üÄŒäÈ† = $Îñ“†·ã[0][$ÕŸÓ´è[193]]; } $÷ßÌ¬Í® = $this->sourceInfo($üÄŒäÈ†); $this->pathInfoFilter($÷ßÌ¬Í®); return $÷ßÌ¬Í®; } protected function updateModifyTime($Û›úë°Ç) { $›äòºÉ¯ =& $_SERVER[ÆªÈ–¬]; $÷‡Ÿø  = defined($›äòºÉ¯[2190]) ? USER_ID : 0; if (!$Û›úë°Ç) { return; } if (!is_array($Û›úë°Ç)) { $Û›úë°Ç = array($Û›úë°Ç); } foreach ($Û›úë°Ç as $ÙÛ—Ï€ => $¼Í¸Ø™) { $Û›úë°Ç[$ÙÛ—Ï€] = intval($¼Í¸Ø™); $this->sourceCacheClear($¼Í¸Ø™); } $À— ì = array($›äòºÉ¯[193] => array($›äòºÉ¯[7], $Û›úë°Ç)); $İğí‚ùÔ = array($›äòºÉ¯[651] => $÷‡Ÿø , $›äòºÉ¯[498] => time()); $this->where($À— ì)->save($İğí‚ùÔ); } public function folderSizeReset($¨ùÎı‰, $¯„õæ§ = false) { $°ƒšÎåÜ =& $_SERVER[ÆªÈ–¬]; if ($this->statusIgnoreResetSpace) { return; } $Æàì‘Ì† = $this->sourceInfo($¨ùÎı‰); $—×‡ şı = $°ƒšÎåÜ[2276] . $¨ùÎı‰; CacheLock::lock($—×‡ şı, 20); if ($¯„õæ§ === !1) { $this->sourceCacheClear($¨ùÎı‰); $Æàì‘Ì† = $this->sourceInfo($¨ùÎı‰); $Ã¨ßÒ†¨ = array($°ƒšÎåÜ[477] => $¨ùÎı‰, $°ƒšÎåÜ[504] => 0); $øı½ŸÈ = $this->where($Ã¨ßÒ†¨)->sum($°ƒšÎåÜ[79]); $¯„õæ§ = intval($øı½ŸÈ) - intval($Æàì‘Ì†[$°ƒšÎåÜ[79]]); } if ($¯„õæ§ == 0) { return CacheLock::unlock($—×‡ şı); } $“§¬£Ë = $this->parentLevelArray($Æàì‘Ì†[$°ƒšÎåÜ[584]]); if (!$“§¬£Ë) { $“§¬£Ë = array(); } $“§¬£Ë[] = $Æàì‘Ì†[$°ƒšÎåÜ[193]]; $Ã¨ßÒ†¨ = array($°ƒšÎåÜ[193] => array($°ƒšÎåÜ[492], $“§¬£Ë)); if ($¯„õæ§ < 0) { $Ã¨ßÒ†¨[$°ƒšÎåÜ[79]] = array($°ƒšÎåÜ[1086], abs($¯„õæ§)); } $this->where($Ã¨ßÒ†¨)->setAdd($°ƒšÎåÜ[79], $¯„õæ§); CacheLock::unlock($—×‡ şı); $ˆçø = $°ƒšÎåÜ[2277] . $Æàì‘Ì†[$°ƒšÎåÜ[190]] . $°ƒšÎåÜ[4] . $Æàì‘Ì†[$°ƒšÎåÜ[569]]; $»¢á£ŒÔ = array($Æàì‘Ì†[$°ƒšÎåÜ[190]], $Æàì‘Ì†[$°ƒšÎåÜ[569]]); TaskRun::timeLimitCall($ˆçø, $°ƒšÎåÜ[2278], $»¢á£ŒÔ, 1.5); } public function folderSizeResetChildren($ûÉ¾æ) { $˜Å‹“”Ö =& $_SERVER[ÆªÈ–¬]; $this->sourceCacheClear($ûÉ¾æ); $¨ğØÉ˜‘ = $this->sourceInfo($ûÉ¾æ); $üú‰ø³¦ = array($˜Å‹“”Ö[646] => 1, $˜Å‹“”Ö[649] => $¨ğØÉ˜‘[$˜Å‹“”Ö[569]], $˜Å‹“”Ö[652] => array($˜Å‹“”Ö[612], $¨ğØÉ˜‘[$˜Å‹“”Ö[584]] . $ûÉ¾æ . $˜Å‹“”Ö[613])); $™ÊïÉ«Ú = $˜Å‹“”Ö[2279]; $Ì«ëÅ¨¿ = $this->field($™ÊïÉ«Ú)->where($üú‰ø³¦)->select(); $üú‰ø³¦[$˜Å‹“”Ö[485]] = 0; $Ê“Ÿ§‰õ = $this->field($™ÊïÉ«Ú)->where($üú‰ø³¦)->select(); if (!$Ê“Ÿ§‰õ) { return; } $Ì«ëÅ¨¿[] = $¨ğØÉ˜‘; $Ì«ëÅ¨¿ = array_to_keyvalue($Ì«ëÅ¨¿, $˜Å‹“”Ö[193]); foreach ($Ì«ëÅ¨¿ as $¹Æ¬š¸ => $¿ˆ“Åë) { $Ì«ëÅ¨¿[$¹Æ¬š¸][$˜Å‹“”Ö[2280]] = $Ì«ëÅ¨¿[$¹Æ¬š¸][$˜Å‹“”Ö[79]]; $Ì«ëÅ¨¿[$¹Æ¬š¸][$˜Å‹“”Ö[79]] = 0; } foreach ($Ê“Ÿ§‰õ as $¿ˆ“Åë) { $ã‰íšÉÉ = $¿ˆ“Åë[$˜Å‹“”Ö[192]] . $˜Å‹“”Ö[12]; if (!isset($Ì«ëÅ¨¿[$ã‰íšÉÉ])) { continue; } if ($¿ˆ“Åë[$˜Å‹“”Ö[505]] == $Ì«ëÅ¨¿[$ã‰íšÉÉ][$˜Å‹“”Ö[505]]) { $Ì«ëÅ¨¿[$ã‰íšÉÉ][$˜Å‹“”Ö[79]] += $¿ˆ“Åë[$˜Å‹“”Ö[79]]; } } foreach ($Ì«ëÅ¨¿ as $¿ˆ“Åë) { $×ìŞÚ–æ = $this->parentLevelArray($¿ˆ“Åë[$˜Å‹“”Ö[584]]); foreach ($×ìŞÚ–æ as $ã‰íšÉÉ) { $ã‰íšÉÉ = $ã‰íšÉÉ . $˜Å‹“”Ö[12]; if (!isset($Ì«ëÅ¨¿[$ã‰íšÉÉ])) { continue; } if ($¿ˆ“Åë[$˜Å‹“”Ö[505]] == $Ì«ëÅ¨¿[$ã‰íšÉÉ][$˜Å‹“”Ö[505]]) { $Ì«ëÅ¨¿[$ã‰íšÉÉ][$˜Å‹“”Ö[79]] += $¿ˆ“Åë[$˜Å‹“”Ö[79]]; } } } $µß‹ = array(); foreach ($Ì«ëÅ¨¿ as $¿ˆ“Åë) { if ($¿ˆ“Åë[$˜Å‹“”Ö[79]] == $¿ˆ“Åë[$˜Å‹“”Ö[2280]]) { continue; } $µß‹[] = array($˜Å‹“”Ö[193], $¿ˆ“Åë[$˜Å‹“”Ö[193]], $˜Å‹“”Ö[79], $¿ˆ“Åë[$˜Å‹“”Ö[79]]); } $this->saveAll($µß‹); } public function userSpaceReset($ ×íÈ«â = false) { $¨°Íîü‰ =& $_SERVER[ÆªÈ–¬]; $°ì÷š‹ä = $this->where(array($¨°Íîü‰[190] => self::TYPE_USER, $¨°Íîü‰[569] => $ ×íÈ«â, $¨°Íîü‰[485] => 0))->sum($¨°Íîü‰[79]); $°ì÷š‹ä = !$°ì÷š‹ä || $°ì÷š‹ä <= 0 ? 0 : $°ì÷š‹ä; Model($¨°Íîü‰[577])->userEdit($ ×íÈ«â, array($¨°Íîü‰[1952] => $°ì÷š‹ä)); } public function targetSpaceUpdate($€¹ÒğÀÄ, $Àß“Õ‡) { $‹Çºù­÷ =& $_SERVER[ÆªÈ–¬]; if (!$Àß“Õ‡) { return; } if (!in_array($€¹ÒğÀÄ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $•‰ò¼“ = $this->targetSpaceSize($€¹ÒğÀÄ, $Àß“Õ‡); if ($€¹ÒğÀÄ == self::TYPE_USER) { Model($‹Çºù­÷[577])->userEdit($Àß“Õ‡, array($‹Çºù­÷[1952] => $•‰ò¼“)); } else { if ($€¹ÒğÀÄ == self::TYPE_GROUP) { Model($‹Çºù­÷[585])->groupEdit($Àß“Õ‡, array($‹Çºù­÷[1952] => $•‰ò¼“)); } } } public function targetSpaceSize($‡ŠÓ«ıé, $—’ĞÜÀı) { $†’Ù‡¸ô =& $_SERVER[ÆªÈ–¬]; $ŞÁ§Ëû = 0; $­é¸³«Ä = $this->targetSourceRoot($‡ŠÓ«ıé, $—’ĞÜÀı, !0); foreach ($­é¸³«Ä as $ÊÌÇ“ø») { if (!$ÊÌÇ“ø») { continue; } $ŞÁ§Ëû += floatval($ÊÌÇ“ø»[$†’Ù‡¸ô[79]]); $óòâéØñ = array($†’Ù‡¸ô[652] => array($†’Ù‡¸ô[612], $†’Ù‡¸ô[594] . $ÊÌÇ“ø»[$†’Ù‡¸ô[193]] . $†’Ù‡¸ô[613])); $»¾€åšì = Model($†’Ù‡¸ô[503])->field($†’Ù‡¸ô[491])->where($óòâéØñ)->select(); $»¾€åšì = array_to_keyvalue($»¾€åšì, $†’Ù‡¸ô[12], $†’Ù‡¸ô[193]); $»¾€åšì = array_unique(array_filter($»¾€åšì)); if ($»¾€åšì) { $óòâéØñ = array($†’Ù‡¸ô[491] => array($†’Ù‡¸ô[492], $»¾€åšì)); $ŞÁ§Ëû += floatval($this->where($óòâéØñ)->sum($†’Ù‡¸ô[79])); } } $ŞÁ§Ëû = !$ŞÁ§Ëû || $ŞÁ§Ëû <= 0 ? 0 : $ŞÁ§Ëû; return $ŞÁ§Ëû; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¼ŠÂòİı) { return $this->fileTypeProfile($¼ŠÂòİı, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÑÖØ…µó) { return $this->fileTypeProfile($ÑÖØ…µó, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ì©ÍØà„, $êßĞÒŒš) { $£·á×Ì =& $_SERVER[ÆªÈ–¬]; $ÛèùÈüñ = $£·á×Ì[2281] . $ì©ÍØà„ . $£·á×Ì[11] . $êßĞÒŒš; $˜áú¡ÏÔ = Cache::get($ÛèùÈüñ); if ($˜áú¡ÏÔ) { return $˜áú¡ÏÔ; } $ø¢ğĞ‡ = array($£·á×Ì[646] => 0); if ($ì©ÍØà„ != !1) { $ø¢ğĞ‡[$£·á×Ì[569]] = $ì©ÍØà„; $ø¢ğĞ‡[$£·á×Ì[190]] = $êßĞÒŒš; } $ğóøšş = array(); $ğóøšş[$£·á×Ì[2282]] = array($£·á×Ì[2283] => LNG($£·á×Ì[2282]), $£·á×Ì[2284] => $this->where($ø¢ğĞ‡)->count(), $£·á×Ì[617] => $this->where($ø¢ğĞ‡)->sum($£·á×Ì[79])); $™æî²ŒÊ = KodIO::fileTypeList(); foreach ($™æî²ŒÊ as $¥êÔßŸ§ => $×Í³ÁŒå) { $ø¢ğĞ‡[$£·á×Ì[486]] = $this->fileTypeWhere($¥êÔßŸ§); $ğóøšş[$¥êÔßŸ§] = array($£·á×Ì[2283] => $×Í³ÁŒå[$£·á×Ì[32]], $£·á×Ì[2284] => $this->where($ø¢ğĞ‡)->count(), $£·á×Ì[617] => $this->where($ø¢ğĞ‡)->sum($£·á×Ì[79])); } Cache::set($ÛèùÈüñ, $ğóøšş, 1200); return $ğóøšş; } public function fileNameExist($§ƒ™‰„ô, $ÑÏá¶ñ ) { $—€µàÇç =& $_SERVER[ÆªÈ–¬]; $ÄÙÌ˜Çî = $this->field($—€µàÇç[2285])->where(array($—€µàÇç[192] => $§ƒ™‰„ô, $—€µàÇç[32] => $ÑÏá¶ñ , $—€µàÇç[505] => 0))->find(); return is_array($ÄÙÌ˜Çî) ? $ÄÙÌ˜Çî[$—€µàÇç[193]] : !1; } public function childList($Œ…„ûöÍ) { $÷à†Â¤€ =& $_SERVER[ÆªÈ–¬]; $¸Äô·¶ = $÷à†Â¤€[2258] . $Œ…„ûöÍ; if (isset(self::$cacheChildList[$¸Äô·¶])) { return self::$cacheChildList[$¸Äô·¶]; } $æÑış·Æ = array($÷à†Â¤€[192] => intval($Œ…„ûöÍ), $÷à†Â¤€[505] => 0); $§è›¢›û = $this->where($æÑış·Æ)->select(); $§è›¢›û = $§è›¢›û ? $§è›¢›û : array(); self::$cacheChildList[$¸Äô·¶] = $§è›¢›û; foreach ($§è›¢›û as $Š˜êÎ°Å) { $¸Äô·¶ = $÷à†Â¤€[533] . $Š˜êÎ°Å[$÷à†Â¤€[193]]; self::$cacheSourceInfo[$¸Äô·¶] = $Š˜êÎ°Å; } return $§è›¢›û; } public function fileNameAuto($°¿¿Ÿ¼Ó, $•ºíò‚Ü, $øõõ¥§á = REPEAT_RENAME, $¦ã²ğÚõ = false) { $â¼Ò¯…ƒ =& $_SERVER[ÆªÈ–¬]; $éñÇÑàß = get_path_ext($•ºíò‚Ü); $Ã³áŠç‰ = $éñÇÑàß ? get_path_ext_name($•ºíò‚Ü) . $â¼Ò¯…ƒ[2286] . $éñÇÑàß : $•ºíò‚Ü . $â¼Ò¯…ƒ[460]; $ùš»éè¦ = array($â¼Ò¯…ƒ[192] => $°¿¿Ÿ¼Ó, $â¼Ò¯…ƒ[505] => 0, $â¼Ò¯…ƒ[32] => array($â¼Ò¯…ƒ[459], $Ã³áŠç‰)); $ÎÇ¤öì = $this->field($â¼Ò¯…ƒ[32])->where($ùš»éè¦)->select(); $í“Ü„â— = array_to_keyvalue($ÎÇ¤öì, $â¼Ò¯…ƒ[12], $â¼Ò¯…ƒ[32]); return $this->fileNameAutoGet($í“Ü„â—, $•ºíò‚Ü, $øõõ¥§á, $¦ã²ğÚõ); } public function fileNameAutoGet($âÆ„ªŠÆ, $¥€ºõ«¼, $ Ÿ²îŞê, $¾£€Ğò) { $ì¾Ğ’¾Ò =& $_SERVER[ÆªÈ–¬]; if ($ Ÿ²îŞê == REPEAT_REPLACE || !$âÆ„ªŠÆ || !in_array_not_case($¥€ºõ«¼, $âÆ„ªŠÆ) || $¾£€Ğò && $ Ÿ²îŞê != REPEAT_RENAME_FOLDER) { return $¥€ºõ«¼; } if ($ Ÿ²îŞê == REPEAT_SKIP) { return !1; } $¥‹ÇøÙ¡ = $ì¾Ğ’¾Ò[10] . get_path_ext($¥€ºõ«¼); $¥‹ÇøÙ¡ = $¥‹ÇøÙ¡ == $ì¾Ğ’¾Ò[10] || $¾£€Ğò ? $ì¾Ğ’¾Ò[12] : $¥‹ÇøÙ¡; for ($ÆŞ™òÖ = 1; $ÆŞ™òÖ <= count($âÆ„ªŠÆ) + 1; $ÆŞ™òÖ++) { $ÙåÖÏªò = substr($¥€ºõ«¼, 0, strlen($¥€ºõ«¼) - strlen($¥‹ÇøÙ¡)); $ØÉ¢‡ì = $ÙåÖÏªò . "\x28{$ÆŞ™òÖ}\x29{$¥‹ÇøÙ¡}"; if (!in_array_not_case($ØÉ¢‡ì, $âÆ„ªŠÆ)) { return $ØÉ¢‡ì; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\162\143\x65\137\162\x65\x63\x79\143\154\x65"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\155\x65", "\x74\x69\155\x65", "\151\156\163\x65\162\x74", "\146\165\156\143\164\151\x6f\156")); public function listData($¯‡İİÇ™ = false) { $¤–Å„çÉ =& $_SERVER[ÆªÈ–¬]; $¯‡İİÇ™ = $¯‡İİÇ™ ? $¯‡İİÇ™ : USER_ID; $Š­±ÄşŞ = $this->where(array($¤–Å„çÉ[1756] => $¯‡İİÇ™))->select(); return array_to_keyvalue($Š­±ÄşŞ, $¤–Å„çÉ[12], $¤–Å„çÉ[193]); } public function moveToRecycle($¢µœ†¼§) { $Êú†ùä  =& $_SERVER[ÆªÈ–¬]; $‰î­ø½ = Model($Êú†ùä [1411]); $¶›‹ªªâ = $‰î­ø½->sourceInfo($¢µœ†¼§); if (!$¶›‹ªªâ || $¶›‹ªªâ[$Êú†ùä [505]] == $Êú†ùä [91]) { return; } $çîÈù›š = array($Êú†ùä [491] => $¢µœ†¼§, $Êú†ùä [1756] => USER_ID, $Êú†ùä [648] => $¶›‹ªªâ[$Êú†ùä [190]], $Êú†ùä [649] => $¶›‹ªªâ[$Êú†ùä [569]], $Êú†ùä [652] => $¶›‹ªªâ[$Êú†ùä [584]]); $this->add($çîÈù›š); $this->recycleMove($¢µœ†¼§, 1); if ($¶›‹ªªâ[$Êú†ùä [485]] == $Êú†ùä [91]) { $»‹¯´ëê = array($Êú†ùä [652] => array($Êú†ùä [612], $¶›‹ªªâ[$Êú†ùä [584]] . $¢µœ†¼§ . $Êú†ùä [613])); $‰î­ø½->where($»‹¯´ëê)->setField($Êú†ùä [505], 1); } } public function clear() { $this->remove(!1); } public function remove($§­ıÌ—Š = false, $Ùùº“Ø = false) { $î°­ÚÖ =& $_SERVER[ÆªÈ–¬]; $Ùùº“Ø = $Ùùº“Ø ? $Ùùº“Ø : USER_ID; $óõƒı»ø = Model($î°­ÚÖ[1411]); $Œ£ÂÖª = $this->listData($Ùùº“Ø); $§­ıÌ—Š = $§­ıÌ—Š === !1 ? !1 : $§­ıÌ—Š; $–ä³ÏØÆ = array(); foreach ($Œ£ÂÖª as $œÂÆõæ²) { if ($§­ıÌ—Š != !1 && !in_array($œÂÆõæ², $§­ıÌ—Š)) { continue; } $é¶ïêùû = $óõƒı»ø->sourceInfo($œÂÆõæ²); $óõƒı»ø->remove($œÂÆõæ², !1); $µ©ë¹½‡ = $é¶ïêùû[$î°­ÚÖ[190]] . $î°­ÚÖ[11] . $é¶ïêùû[$î°­ÚÖ[569]]; $–ä³ÏØÆ[$µ©ë¹½‡] = array($î°­ÚÖ[648] => $é¶ïêùû[$î°­ÚÖ[190]], $î°­ÚÖ[569] => $é¶ïêùû[$î°­ÚÖ[569]]); $this->where(array($î°­ÚÖ[193] => $œÂÆõæ²))->delete(); } foreach ($–ä³ÏØÆ as $°ó±Ã»Ğ) { $óõƒı»ø->targetSpaceUpdate($°ó±Ã»Ğ[$î°­ÚÖ[190]], $°ó±Ã»Ğ[$î°­ÚÖ[569]]); } } public function restore($õÀ÷Û© = false) { $–¸šª’± = $this->listData(); $this->_restoreSource($–¸šª’±, $õÀ÷Û©); } public function removeUserAll($„ıíÅï) { $this->remove(!1, $„ıíÅï); } public function restoreItem($£Ë†‘¥“) { $this->_restoreSource(array($£Ë†‘¥“), array($£Ë†‘¥“)); } private function _restoreSource($¢œÌš, $ÔÉÃ°Ò) { $áÁ—å¢’ =& $_SERVER[ÆªÈ–¬]; $ÅïşŸ¶¤ = Model($áÁ—å¢’[1411]); $ÔÉÃ°Ò = $ÔÉÃ°Ò == !1 ? !1 : $ÔÉÃ°Ò; if (!$¢œÌš) { return !0; } $ï˜„„¼× = array(); foreach ($¢œÌš as $õ×š£¬Ú) { if ($ÔÉÃ°Ò != !1 && !in_array($õ×š£¬Ú, $ÔÉÃ°Ò)) { continue; } $ç¨æî½õ = $ÅïşŸ¶¤->sourceInfo($õ×š£¬Ú); $ã‘Ë‘ºË = $ÅïşŸ¶¤->sourceInfo($ç¨æî½õ[$áÁ—å¢’[192]]); if ($ã‘Ë‘ºË[$áÁ—å¢’[505]] == $áÁ—å¢’[91]) { continue; } $ÅïşŸ¶¤->lockMoveStart($õ×š£¬Ú); $this->recycleMove($õ×š£¬Ú, 0); if ($ç¨æî½õ[$áÁ—å¢’[485]] == $áÁ—å¢’[91]) { $ğ¸ıÛøÍ = array($áÁ—å¢’[652] => array($áÁ—å¢’[612], $ç¨æî½õ[$áÁ—å¢’[584]] . $õ×š£¬Ú . $áÁ—å¢’[613])); $ÅïşŸ¶¤->where($ğ¸ıÛøÍ)->setField($áÁ—å¢’[505], 0); $this->restoreFolderChildren($õ×š£¬Ú, $¢œÌš); } $this->where(array($áÁ—å¢’[193] => $õ×š£¬Ú))->delete(); $ÅïşŸ¶¤->folderSizeReset($ç¨æî½õ[$áÁ—å¢’[192]]); $ï˜„„¼×[] = $ç¨æî½õ[$áÁ—å¢’[192]]; if ($ç¨æî½õ[$áÁ—å¢’[485]] == $áÁ—å¢’[91]) { $ï˜„„¼×[] = $õ×š£¬Ú; } $ÅïşŸ¶¤->lockMoveEnd($õ×š£¬Ú); } $ÅïşŸ¶¤->updateModifyTime($ï˜„„¼×); } private function restoreFolderChildren($»è©¢‰ü, $¤üçÛ©Û) { $ßş¬êŒ¸ =& $_SERVER[ÆªÈ–¬]; $‘ÁÈÀ³ = Model($ßş¬êŒ¸[1411]); $¶‡Áà×® = array($ßş¬êŒ¸[193] => array($ßş¬êŒ¸[7], array())); foreach ($¤üçÛ©Û as $î¡ïÙÅ) { if ($î¡ïÙÅ == $»è©¢‰ü) { continue; } if (!$‘ÁÈÀ³->isParentOf($»è©¢‰ü, $î¡ïÙÅ)) { continue; } $¢®¯‰—ò = $‘ÁÈÀ³->sourceInfo($î¡ïÙÅ); if ($¢®¯‰—ò[$ßş¬êŒ¸[485]] == $ßş¬êŒ¸[91]) { $¶‡Áà×®[] = array($ßş¬êŒ¸[652] => array($ßş¬êŒ¸[612], $¢®¯‰—ò[$ßş¬êŒ¸[584]] . $î¡ïÙÅ . $ßş¬êŒ¸[613])); } else { $¶‡Áà×®[$ßş¬êŒ¸[193]][1][] = $î¡ïÙÅ; } } if (!$¶‡Áà×®[$ßş¬êŒ¸[193]][1]) { unset($¶‡Áà×®[$ßş¬êŒ¸[193]]); } if (!$¶‡Áà×®) { return; } if (is_array($¶‡Áà×®[$ßş¬êŒ¸[193]]) && is_array($¶‡Áà×®[$ßş¬êŒ¸[193]][1])) { $¶‡Áà×®[$ßş¬êŒ¸[193]][1] = array_unique($¶‡Áà×®[$ßş¬êŒ¸[193]][1]); } $¶‡Áà×®[$ßş¬êŒ¸[1071]] = $ßş¬êŒ¸[2066]; $‘ÁÈÀ³->where($¶‡Áà×®)->setField($ßş¬êŒ¸[505], 1); } private function recycleMove($­ù­„¶ç, $­Ï¾±¢ˆ = 1) { $ê˜³¿ =& $_SERVER[ÆªÈ–¬]; $îÄŸãıˆ = Model($ê˜³¿[1411]); $â³¼Å¥ü = Model($ê˜³¿[2287]); $¹ß×–¨ø = array($ê˜³¿[193] => $­ù­„¶ç); if ($­Ï¾±¢ˆ) { $îÄŸãıˆ->where($¹ß×–¨ø)->setField($ê˜³¿[505], 1); $â³¼Å¥ü->eventRecycle($­ù­„¶ç, $ê˜³¿[2288]); } else { $œÌÀ£Ãß = $îÄŸãıˆ->where($¹ß×–¨ø)->find(); $ş§ï÷° = $œÌÀ£Ãß[$ê˜³¿[485]] == $ê˜³¿[91]; $¸ˆ©›¶Ç = $îÄŸãıˆ->fileNameAuto($œÌÀ£Ãß[$ê˜³¿[192]], $œÌÀ£Ãß[$ê˜³¿[32]], REPEAT_RENAME_FOLDER, $ş§ï÷°); if ($¸ˆ©›¶Ç != $œÌÀ£Ãß[$ê˜³¿[32]]) { $îÄŸãıˆ->rename($­ù­„¶ç, $¸ˆ©›¶Ç); } $îÄŸãıˆ->where($¹ß×–¨ø)->setField($ê˜³¿[505], 0); $â³¼Å¥ü->eventRecycle($­ù­„¶ç, $ê˜³¿[2289]); } } } goto fãİãÄ¢ª¸; D¶–ï‹”’†: class DbMysql extends Db { public function __construct($¦£ÖÍÎ = '') { $›ó¢­å =& $_SERVER[ÆªÈ–¬]; if (!extension_loaded($›ó¢­å[870])) { think_exception(think_lang($›ó¢­å[14]) . $›ó¢­å[956]); } if (!empty($¦£ÖÍÎ)) { $this->config = $¦£ÖÍÎ; if (empty($this->config[$›ó¢­å[17]])) { $this->config[$›ó¢­å[17]] = $›ó¢­å[12]; } } } public function connect($âÕÕÍÍØ = '', $åğÓ¦”È = 0, $ƒû¼Ãî‹ = false) { $¶íóÏÁî =& $_SERVER[ÆªÈ–¬]; if (!isset($this->linkID[$åğÓ¦”È])) { if (empty($âÕÕÍÍØ)) { $âÕÕÍÍØ = $this->config; } $ıĞ½¤‘Ê = $âÕÕÍÍØ[$¶íóÏÁî[957]] . ($âÕÕÍÍØ[$¶íóÏÁî[958]] ? "\72{$âÕÕÍÍØ[$¶íóÏÁî[958]]}" : $¶íóÏÁî[12]); $Ò¢º¡Ç’ = !empty($âÕÕÍÍØ[$¶íóÏÁî[17]][$¶íóÏÁî[18]]) ? $âÕÕÍÍØ[$¶íóÏÁî[17]][$¶íóÏÁî[18]] : $this->pconnect; if ($Ò¢º¡Ç’) { $this->linkID[$åğÓ¦”È] = mysql_pconnect($ıĞ½¤‘Ê, $âÕÕÍÍØ[$¶íóÏÁî[959]], $âÕÕÍÍØ[$¶íóÏÁî[960]], 131072); } else { $this->linkID[$åğÓ¦”È] = mysql_connect($ıĞ½¤‘Ê, $âÕÕÍÍØ[$¶íóÏÁî[959]], $âÕÕÍÍØ[$¶íóÏÁî[960]], !0, 131072); } if (!$this->linkID[$åğÓ¦”È] || !empty($âÕÕÍÍØ[$¶íóÏÁî[21]]) && !mysql_select_db($âÕÕÍÍØ[$¶íóÏÁî[21]], $this->linkID[$åğÓ¦”È])) { think_exception(mysql_error()); } $¤’¥ó¡ = mysql_get_server_info($this->linkID[$åğÓ¦”È]); mysql_query($¶íóÏÁî[961] . think_config($¶íóÏÁî[962]) . $¶íóÏÁî[58], $this->linkID[$åğÓ¦”È]); if ($¤’¥ó¡ > $¶íóÏÁî[963]) { mysql_query($¶íóÏÁî[964], $this->linkID[$åğÓ¦”È]); } $this->connected = !0; if (1 != think_config($¶íóÏÁî[22])) { unset($this->config); } } return $this->linkID[$åğÓ¦”È]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¹²•Øß†) { $±øÅå†Õ =& $_SERVER[ÆªÈ–¬]; if (0 === stripos($¹²•Øß†, $±øÅå†Õ[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¹²•Øß†; if ($this->queryID) { $this->free(); } think_action_status($±øÅå†Õ[23], 1); think_status($±øÅå†Õ[24]); $this->queryID = mysql_query($¹²•Øß†, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($“¹üßö) { $‹¿Ïšµ÷ =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $“¹üßö; if ($this->queryID) { $this->free(); } think_action_status($‹¿Ïšµ÷[25], 1); think_status($‹¿Ïšµ÷[24]); $ÍŒâá¶å = mysql_query($“¹üßö, $this->_linkID); $this->debug(); if (!1 === $ÍŒâá¶å) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÆªÈ–¬][965], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $éö÷Ú = mysql_query($_SERVER[ÆªÈ–¬][966], $this->_linkID); $this->transTimes = 0; if (!$éö÷Ú) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‘–¹´« = mysql_query($_SERVER[ÆªÈ–¬][967], $this->_linkID); $this->transTimes = 0; if (!$‘–¹´«) { $this->error(); return !1; } } return !0; } private function getAll() { $ÃÀ÷šƒÆ = array(); if ($this->numRows > 0) { while ($›ö¶‚Ò½ = mysql_fetch_assoc($this->queryID)) { $ÃÀ÷šƒÆ[] = $›ö¶‚Ò½; } mysql_data_seek($this->queryID, 0); } return $ÃÀ÷šƒÆ; } public function getFields($ŠŸàéƒ) { $Ÿ–áºª£ =& $_SERVER[ÆªÈ–¬]; $¸ç ŠÒ÷ = $this->query($Ÿ–áºª£[968] . $this->parseKey($ŠŸàéƒ)); $à©µ€ç“ = array(); if ($¸ç ŠÒ÷) { foreach ($¸ç ŠÒ÷ as $™˜öÏ–„ => $Ü·ÇÜÃ) { $à©µ€ç“[$Ü·ÇÜÃ[$Ÿ–áºª£[31]]] = array($Ÿ–áºª£[32] => $Ü·ÇÜÃ[$Ÿ–áºª£[31]], $Ÿ–áºª£[33] => $Ü·ÇÜÃ[$Ÿ–áºª£[34]], $Ÿ–áºª£[35] => (bool) (strtoupper($Ü·ÇÜÃ[$Ÿ–áºª£[36]]) === $Ÿ–áºª£[969]), $Ÿ–áºª£[37] => $Ü·ÇÜÃ[$Ÿ–áºª£[38]], $Ÿ–áºª£[39] => strtolower($Ü·ÇÜÃ[$Ÿ–áºª£[40]]) == $Ÿ–áºª£[41], $Ÿ–áºª£[42] => strtolower($Ü·ÇÜÃ[$Ÿ–áºª£[43]]) == $Ÿ–áºª£[44]); } } return $à©µ€ç“; } public function getTables($²ÆÅåÒ· = '') { $ÚÆ„ =& $_SERVER[ÆªÈ–¬]; if (!empty($²ÆÅåÒ·)) { $µíÒ¡‘ı = $ÚÆ„[970] . $²ÆÅåÒ· . $ÚÆ„[971]; } else { $µíÒ¡‘ı = $ÚÆ„[972]; } $ÎÓÂØÅ = $this->query($µíÒ¡‘ı); $û€ú¹‰˜ = array(); foreach ($ÎÓÂØÅ as $Ï¤ãÍ¶² => $¥¸Æ»Ç) { $û€ú¹‰˜[$Ï¤ãÍ¶²] = current($¥¸Æ»Ç); } return $û€ú¹‰˜; } public function replace($™€àı±Œ, $Ş™±ÒÃÌ = array()) { $£¦•²Ì³ =& $_SERVER[ÆªÈ–¬]; foreach ($™€àı±Œ as $¿àÁˆîÃ => $™Àˆà›‹) { $óŒåÚÔÇ = $this->parseValue($™Àˆà›‹); if (is_scalar($óŒåÚÔÇ)) { $ĞŞËã—µ[] = $óŒåÚÔÇ; $ØÂÄäŠÁ[] = $this->parseKey($¿àÁˆîÃ); } } $·ØêÛ¥Ş = $£¦•²Ì³[973] . $this->parseTable($Ş™±ÒÃÌ[$£¦•²Ì³[356]]) . $£¦•²Ì³[974] . implode($£¦•²Ì³[50], $ØÂÄäŠÁ) . $£¦•²Ì³[975] . implode($£¦•²Ì³[50], $ĞŞËã—µ) . $£¦•²Ì³[976]; return $this->execute($·ØêÛ¥Ş); } public function insertAll($òëàÒŒï, $©Ê³”× = array(), $¡ŠæñÜœ = false) { $¦”“‡ê =& $_SERVER[ÆªÈ–¬]; if (!is_array($òëàÒŒï[0])) { return !1; } $“¥´áÛ = array_keys($òëàÒŒï[0]); $ıµŒëñ = array(); foreach ($òëàÒŒï as $Åµí±¼Ö) { $ä‹×Õ“² = array(); foreach ($Åµí±¼Ö as $şè¡Éò¶ => $ØßÙÉÓÈ) { $ØßÙÉÓÈ = $this->parseValue($ØßÙÉÓÈ); if (is_scalar($ØßÙÉÓÈ)) { $ä‹×Õ“²[] = $ØßÙÉÓÈ; } } $ıµŒëñ[] = $¦”“‡ê[337] . implode($¦”“‡ê[50], $ä‹×Õ“²) . $¦”“‡ê[976]; } array_walk($“¥´áÛ, array($this, $¦”“‡ê[977])); $¯çüÔĞ = ($¡ŠæñÜœ ? $¦”“‡ê[978] : $¦”“‡ê[979]) . $¦”“‡ê[980] . $this->parseTable($©Ê³”×[$¦”“‡ê[356]]) . $¦”“‡ê[974] . implode($¦”“‡ê[50], $“¥´áÛ) . $¦”“‡ê[981] . implode($¦”“‡ê[50], $ıµŒëñ); return $this->execute($¯çüÔĞ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ø’÷¯…ä =& $_SERVER[ÆªÈ–¬]; $this->error = mysql_errno() . $ø’÷¯…ä[4] . mysql_error($this->_linkID); if ($ø’÷¯…ä[12] != $this->queryStr) { $this->error .= LNG($ø’÷¯…ä[48]) . $this->queryStr; } think_trace($this->error, $ø’÷¯…ä[12], $ø’÷¯…ä[49]); return $this->error; } public function escapeString($Ï»‰”ÙÔ) { if ($this->_linkID) { return mysql_real_escape_string($Ï»‰”ÙÔ, $this->_linkID); } else { return mysql_escape_string($Ï»‰”ÙÔ); } } public function parseKey(&$ï©Ï‚â, $ãÈâáÅ– = true) { $Ä‚çØÈ• =& $_SERVER[ÆªÈ–¬]; if ($ãÈâáÅ–) { $ï©Ï‚â = $this->parseKeyCheck($ï©Ï‚â); } if ($ï©Ï‚â != $Ä‚çØÈ•[220] && !preg_match($Ä‚çØÈ•[982], $ï©Ï‚â)) { $ï©Ï‚â = $Ä‚çØÈ•[461] . trim($ï©Ï‚â, $Ä‚çØÈ•[461]) . $Ä‚çØÈ•[461]; } return $ï©Ï‚â; } } class DbMysqli extends Db { public function __construct($›“Ì·‹° = '') { $œ®µÚÌê =& $_SERVER[ÆªÈ–¬]; if (!extension_loaded($œ®µÚÌê[983])) { think_exception(think_lang($œ®µÚÌê[14]) . $œ®µÚÌê[984]); } if (!empty($›“Ì·‹°)) { $this->config = $›“Ì·‹°; if (empty($this->config[$œ®µÚÌê[17]])) { $this->config[$œ®µÚÌê[17]] = $œ®µÚÌê[12]; } } } public function connect($€¿µÑ‰ˆ = '', $ôš¸¶” = 0) { $†ê¦ªÛş =& $_SERVER[ÆªÈ–¬]; if (!isset($this->linkID[$ôš¸¶”])) { if (empty($€¿µÑ‰ˆ)) { $€¿µÑ‰ˆ = $this->config; } $this->linkID[$ôš¸¶”] = new mysqli($€¿µÑ‰ˆ[$†ê¦ªÛş[957]], $€¿µÑ‰ˆ[$†ê¦ªÛş[959]], $€¿µÑ‰ˆ[$†ê¦ªÛş[960]], $€¿µÑ‰ˆ[$†ê¦ªÛş[21]], $€¿µÑ‰ˆ[$†ê¦ªÛş[958]] ? intval($€¿µÑ‰ˆ[$†ê¦ªÛş[958]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $²¡äÃğù = $this->linkID[$ôš¸¶”]->server_version; $this->linkID[$ôš¸¶”]->query($†ê¦ªÛş[961] . think_config($†ê¦ªÛş[962]) . $†ê¦ªÛş[58]); if ($²¡äÃğù > $†ê¦ªÛş[963]) { $this->linkID[$ôš¸¶”]->query($†ê¦ªÛş[964]); } $this->connected = !0; if (1 != think_config($†ê¦ªÛş[22])) { unset($this->config); } } return $this->linkID[$ôš¸¶”]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($²ÃŠş—Ş) { $ûğÙº°ó =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $²ÃŠş—Ş; if ($this->queryID) { $this->free(); } think_action_status($ûğÙº°ó[23], 1); think_status($ûğÙº°ó[24]); $this->queryID = $this->_linkID->query($²ÃŠş—Ş); if ($this->_linkID->more_results()) { while (($şŠ™·„ƒ = $this->_linkID->next_result()) != NULL) { $şŠ™·„ƒ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÜÌ€›  ) { $æØåÜÈà =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÜÌ€›  ; if ($this->queryID) { $this->free(); } think_action_status($æØåÜÈà[25], 1); think_status($æØåÜÈà[24]); $Şœ§®íÂ = $this->_linkID->query($ÜÌ€›  ); $this->debug(); if (!1 === $Şœ§®íÂ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $§á‘ê€å = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$§á‘ê€å) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $–ŒÇôÈÓ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$–ŒÇôÈÓ) { $this->error(); return !1; } } return !0; } private function getAll() { $ùŠáë­¿ = array(); if ($this->numRows > 0) { for ($º ¾÷¦ = 0; $º ¾÷¦ < $this->numRows; $º ¾÷¦++) { $ùŠáë­¿[$º ¾÷¦] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ùŠáë­¿; } public function getFields($ˆ“ø­â¯) { $—ôô£Ô™ =& $_SERVER[ÆªÈ–¬]; $ÉãÖ¥½ª = $this->query($—ôô£Ô™[968] . $this->parseKey($ˆ“ø­â¯)); $Ğ·ıî©Ã = array(); if ($ÉãÖ¥½ª) { foreach ($ÉãÖ¥½ª as $³æ¬Ôì± => $ä¦åÄµÌ) { $Ğ·ıî©Ã[$ä¦åÄµÌ[$—ôô£Ô™[31]]] = array($—ôô£Ô™[32] => $ä¦åÄµÌ[$—ôô£Ô™[31]], $—ôô£Ô™[33] => $ä¦åÄµÌ[$—ôô£Ô™[34]], $—ôô£Ô™[35] => (bool) ($ä¦åÄµÌ[$—ôô£Ô™[36]] === $—ôô£Ô™[12]), $—ôô£Ô™[37] => $ä¦åÄµÌ[$—ôô£Ô™[38]], $—ôô£Ô™[39] => strtolower($ä¦åÄµÌ[$—ôô£Ô™[40]]) == $—ôô£Ô™[41], $—ôô£Ô™[42] => strtolower($ä¦åÄµÌ[$—ôô£Ô™[43]]) == $—ôô£Ô™[44]); } } return $Ğ·ıî©Ã; } public function getTables($ñ¶ÏÀÚ” = '') { $´ªÆß©« =& $_SERVER[ÆªÈ–¬]; $ªí¾ƒØ = !empty($ñ¶ÏÀÚ”) ? $´ªÆß©«[970] . $ñ¶ÏÀÚ” . $´ªÆß©«[971] : $´ªÆß©«[972]; $ş³Ê ü¸ = $this->query($ªí¾ƒØ); $•²ªœ£Ö = array(); if ($ş³Ê ü¸) { foreach ($ş³Ê ü¸ as $ †’–äŠ => $Ñööşı¿) { $•²ªœ£Ö[$ †’–äŠ] = current($Ñööşı¿); } } return $•²ªœ£Ö; } public function replace($³‘ØÜæ, $ı×Ù·°õ = array()) { $ĞÑ™§¡Ğ =& $_SERVER[ÆªÈ–¬]; foreach ($³‘ØÜæ as $ÃÜô¢Ô => $ß€§†) { $˜àÍ®à = $this->parseValue($ß€§†); if (is_scalar($˜àÍ®à)) { $£ğ»ü¹­[] = $˜àÍ®à; $ÒåŞİ¶Œ[] = $this->parseKey($ÃÜô¢Ô); } } $“°¬¶ = $ĞÑ™§¡Ğ[973] . $this->parseTable($ı×Ù·°õ[$ĞÑ™§¡Ğ[356]]) . $ĞÑ™§¡Ğ[974] . implode($ĞÑ™§¡Ğ[50], $ÒåŞİ¶Œ) . $ĞÑ™§¡Ğ[975] . implode($ĞÑ™§¡Ğ[50], $£ğ»ü¹­) . $ĞÑ™§¡Ğ[976]; return $this->execute($“°¬¶); } public function insertAll($½Ã¾¥ÍÊ, $ü¸ºô–¤ = array(), $¹Ÿµ•úû = false) { $ğÅ¿¿ =& $_SERVER[ÆªÈ–¬]; if (!is_array($½Ã¾¥ÍÊ[0])) { return !1; } $úôæ¥šË = array_keys($½Ã¾¥ÍÊ[0]); $ÚûÉ¸ŸÑ = array(); foreach ($½Ã¾¥ÍÊ as $İ«‚ìè) { $ü›ºÃäš = array(); foreach ($İ«‚ìè as $şÓ¸»Éî => $¨¨ş é÷) { $¨¨ş é÷ = $this->parseValue($¨¨ş é÷); if (is_scalar($¨¨ş é÷)) { $ü›ºÃäš[] = $¨¨ş é÷; } } $ÚûÉ¸ŸÑ[] = $ğÅ¿¿[337] . implode($ğÅ¿¿[50], $ü›ºÃäš) . $ğÅ¿¿[976]; } array_walk($úôæ¥šË, array($this, $ğÅ¿¿[977])); $Í¡ğ£³Ã = $¹Ÿµ•úû ? $ğÅ¿¿[978] : $ğÅ¿¿[979]; $¤¼ª§ÍŒ = $Í¡ğ£³Ã . $ğÅ¿¿[980] . $this->parseTable($ü¸ºô–¤[$ğÅ¿¿[356]]) . $ğÅ¿¿[974] . implode($ğÅ¿¿[50], $úôæ¥šË) . $ğÅ¿¿[981] . implode($ğÅ¿¿[50], $ÚûÉ¸ŸÑ); return $this->execute($¤¼ª§ÍŒ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ú¨µâ˜™ =& $_SERVER[ÆªÈ–¬]; $this->error = $this->_linkID->errno . $Ú¨µâ˜™[4] . $this->_linkID->error; if ($Ú¨µâ˜™[12] != $this->queryStr) { $this->error .= LNG($Ú¨µâ˜™[48]) . $this->queryStr; } think_trace($this->error, $Ú¨µâ˜™[12], $Ú¨µâ˜™[49]); return $this->error; } public function escapeString($ªÃ‡‹µ›) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ªÃ‡‹µ›); } else { return addslashes($ªÃ‡‹µ›); } } public function parseKey(&$û…­ûçá, $é—éÁœ¨ = true) { $˜Î©‹ =& $_SERVER[ÆªÈ–¬]; if ($é—éÁœ¨) { $û…­ûçá = $this->parseKeyCheck($û…­ûçá); } if ($û…­ûçá != $˜Î©‹[220] && !preg_match($˜Î©‹[982], $û…­ûçá)) { $û…­ûçá = $˜Î©‹[461] . trim($û…­ûçá, $˜Î©‹[461]) . $˜Î©‹[461]; } return $û…­ûçá; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($œîÕ ® = '') { $õŸê° =& $_SERVER[ÆªÈ–¬]; if (!class_exists($õŸê°[985])) { think_exception(think_lang($õŸê°[14]) . $õŸê°[986]); } if (!empty($œîÕ ®)) { $this->config = $œîÕ ®; if (empty($this->config[$õŸê°[17]])) { $this->config[$õŸê°[17]] = array(); } } } public function connect($´Ö–¯á« = '', $íŸµ˜½å = 0) { $Ì‡ùïû¼ =& $_SERVER[ÆªÈ–¬]; if (!isset($this->linkID[$íŸµ˜½å])) { if (empty($´Ö–¯á«)) { $´Ö–¯á« = $this->config; } $’À©İ ¡ = !empty($´Ö–¯á«[$Ì‡ùïû¼[17]][$Ì‡ùïû¼[18]]) ? $´Ö–¯á«[$Ì‡ùïû¼[17]][$Ì‡ùïû¼[18]] : $this->pconnect; if ($’À©İ ¡) { $´Ö–¯á«[$Ì‡ùïû¼[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$íŸµ˜½å] = new PDO($´Ö–¯á«[$Ì‡ùïû¼[987]], $´Ö–¯á«[$Ì‡ùïû¼[959]], $´Ö–¯á«[$Ì‡ùïû¼[960]], $´Ö–¯á«[$Ì‡ùïû¼[17]]); } catch (PDOException $Õ´­ ıŒ) { think_exception($Õ´­ ıŒ->getMessage()); } $this->dbType = $this->_getDsnType($´Ö–¯á«[$Ì‡ùïû¼[987]]); if (in_array($this->dbType, array($Ì‡ùïû¼[988], $Ì‡ùïû¼[989], $Ì‡ùïû¼[990], $Ì‡ùïû¼[991]))) { think_exception($Ì‡ùïû¼[992] . $this->dbType . $Ì‡ùïû¼[993] . $this->dbType . $Ì‡ùïû¼[994]); } if (!$this->linkID[$íŸµ˜½å]) { think_exception($Ì‡ùïû¼[995]); } try { $this->linkID[$íŸµ˜½å]->exec($Ì‡ùïû¼[996] . think_config($Ì‡ùïû¼[962])); } catch (Exception $Õ´­ ıŒ) { } $this->connected = !0; if (1 != think_config($Ì‡ùïû¼[22])) { unset($this->config); } } return $this->linkID[$íŸµ˜½å]; } public function free() { $this->PDOStatement = null; } public function query($¦ğô‰‘š, $‘‹­ÜË¢ = array()) { $¿šÜôˆ =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦ğô‰‘š; if (!empty($‘‹­ÜË¢)) { $this->queryStr .= $¿šÜôˆ[997] . print_r($‘‹­ÜË¢, !0) . $¿šÜôˆ[998]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¿šÜôˆ[23], 1); think_status($¿šÜôˆ[24]); $this->PDOStatement = $this->_linkID->prepare($¦ğô‰‘š); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‡Šò…­á = $this->PDOStatement->execute($‘‹­ÜË¢); $this->debug(); if (!1 === $‡Šò…­á) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ú®ÇçÏù, $€€çÜÏ§ = array()) { $Â‰©£ºã =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ú®ÇçÏù; if (!empty($€€çÜÏ§)) { $this->queryStr .= $Â‰©£ºã[997] . print_r($€€çÜÏ§, !0) . $Â‰©£ºã[998]; } $öØîÑİ¸ = !1; if ($this->dbType == $Â‰©£ºã[991]) { if (preg_match($Â‰©£ºã[999], $this->queryStr, $Ñ³ğ¶ñ×)) { $this->table = think_config($Â‰©£ºã[1000]) . str_ireplace(think_config($Â‰©£ºã[1001]), $Â‰©£ºã[454], $Ñ³ğ¶ñ×[2]); $öØîÑİ¸ = (bool) $this->query($Â‰©£ºã[1002] . strtoupper($this->table) . $Â‰©£ºã[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Â‰©£ºã[25], 1); think_status($Â‰©£ºã[24]); $this->PDOStatement = $this->_linkID->prepare($ú®ÇçÏù); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ï²¼ƒ‰õ = $this->PDOStatement->execute($€€çÜÏ§); $this->debug(); if (!1 === $ï²¼ƒ‰õ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($öØîÑİ¸ || preg_match($Â‰©£ºã[1003], $ú®ÇçÏù)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‹´şŠ« = $this->_linkID->commit(); $this->transTimes = 0; if (!$‹´şŠ«) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $½„ÇÅµã = $this->_linkID->rollback(); $this->transTimes = 0; if (!$½„ÇÅµã) { $this->error(); return !1; } } return !0; } private function getAll() { $¡ĞëÓÑ­ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¡ĞëÓÑ­); return $¡ĞëÓÑ­; } public function getFields($†ëØø†é) { $ÒùÈş¦´ =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!0); if (think_config($ÒùÈş¦´[1004])) { $°Ä¥‰…” = str_replace($ÒùÈş¦´[1005], $†ëØø†é, think_config($ÒùÈş¦´[1004])); } else { switch ($this->dbType) { case $ÒùÈş¦´[988]: case $ÒùÈş¦´[1006]: $°Ä¥‰…” = "\123\x45\x4c\x45\x43\x54\40\40\x20\x63\x6f\x6c\165\155\156\x5f\x6e\x61\x6d\145\40\141\163\40\x27\116\x61\x6d\145\47\54\x20\40\40\144\141\x74\141\x5f\x74\x79\x70\145\40\141\163\x20\x27\124\171\160\x65\x27\54\x20\40\40\x63\157\x6c\165\x6d\x6e\x5f\x64\x65\x66\141\165\x6c\x74\40\141\163\40\47\x44\x65\146\x61\x75\154\x74\x27\x2c\40\x20\x20\151\163\137\x6e\165\154\x6c\141\142\154\145\40\141\x73\x20\47\x4e\165\x6c\x6c\x27\xa\11\x9\x46\x52\x4f\x4d\11\151\156\146\x6f\162\x6d\x61\164\x69\157\x6e\x5f\163\143\150\145\x6d\141\56\x74\x61\142\x6c\145\163\x20\x41\123\40\164\xa\11\11\x4a\117\111\x4e\x9\x69\x6e\x66\157\x72\x6d\141\164\x69\x6f\156\x5f\163\143\x68\145\155\x61\x2e\x63\x6f\154\x75\155\156\163\40\101\x53\40\143\12\11\x9\117\x4e\x20\40\164\x2e\164\141\142\x6c\145\137\x63\141\164\141\x6c\157\x67\40\75\40\143\x2e\x74\x61\142\x6c\x65\137\143\x61\x74\x61\154\157\147\xa\x9\x9\101\x4e\104\40\x74\56\164\x61\142\154\x65\x5f\x73\x63\150\145\155\x61\x20\75\x20\143\x2e\x74\141\x62\154\x65\x5f\163\x63\150\x65\155\x61\xa\x9\x9\101\x4e\x44\x20\164\56\x74\x61\142\x6c\145\137\156\141\155\145\x20\x3d\40\x63\x2e\x74\141\142\154\145\137\x6e\141\x6d\145\12\11\x9\x57\x48\105\122\105\40\x20\40\164\56\x74\141\x62\154\145\x5f\x6e\x61\155\145\x20\x3d\40\x27{$†ëØø†é}\47"; break; case $ÒùÈş¦´[1007]: $°Ä¥‰…” = $ÒùÈş¦´[1008] . $†ëØø†é . $ÒùÈş¦´[1009]; break; case $ÒùÈş¦´[989]: case $ÒùÈş¦´[991]: $°Ä¥‰…” = $ÒùÈş¦´[1010] . $ÒùÈş¦´[1011] . $ÒùÈş¦´[1012] . strtoupper($†ëØø†é) . $ÒùÈş¦´[1013] . strtoupper($†ëØø†é) . $ÒùÈş¦´[1014]; break; case $ÒùÈş¦´[1015]: $°Ä¥‰…” = $ÒùÈş¦´[1016] . $†ëØø†é . $ÒùÈş¦´[1017]; break; case $ÒùÈş¦´[990]: break; case $ÒùÈş¦´[1018]: default: $°Ä¥‰…” = $ÒùÈş¦´[1019] . ($this->dbType == $ÒùÈş¦´[1018] ? "\x60{$†ëØø†é}\140" : $†ëØø†é); } } $Ê¤Êü›¹ = $this->query($°Ä¥‰…”); $¼Š’í¨ò = array(); if ($Ê¤Êü›¹) { foreach ($Ê¤Êü›¹ as $şâôî–í => $–ÙôŒâ¯) { $–ÙôŒâ¯ = array_change_key_case($–ÙôŒâ¯); $–ÙôŒâ¯[$ÒùÈş¦´[32]] = isset($–ÙôŒâ¯[$ÒùÈş¦´[32]]) ? $–ÙôŒâ¯[$ÒùÈş¦´[32]] : $ÒùÈş¦´[454]; $–ÙôŒâ¯[$ÒùÈş¦´[33]] = isset($–ÙôŒâ¯[$ÒùÈş¦´[33]]) ? $–ÙôŒâ¯[$ÒùÈş¦´[33]] : $ÒùÈş¦´[454]; $†ËÕş = isset($–ÙôŒâ¯[$ÒùÈş¦´[350]]) ? $–ÙôŒâ¯[$ÒùÈş¦´[350]] : $–ÙôŒâ¯[$ÒùÈş¦´[32]]; $¼Š’í¨ò[$†ËÕş] = array($ÒùÈş¦´[32] => $†ËÕş, $ÒùÈş¦´[33] => $–ÙôŒâ¯[$ÒùÈş¦´[33]], $ÒùÈş¦´[35] => (bool) (isset($–ÙôŒâ¯[$ÒùÈş¦´[106]]) && $–ÙôŒâ¯[$ÒùÈş¦´[106]] === $ÒùÈş¦´[12] || isset($–ÙôŒâ¯[$ÒùÈş¦´[35]]) && $–ÙôŒâ¯[$ÒùÈş¦´[35]] === $ÒùÈş¦´[12]), $ÒùÈş¦´[37] => isset($–ÙôŒâ¯[$ÒùÈş¦´[37]]) ? $–ÙôŒâ¯[$ÒùÈş¦´[37]] : (isset($–ÙôŒâ¯[$ÒùÈş¦´[56]]) ? $–ÙôŒâ¯[$ÒùÈş¦´[56]] : $ÒùÈş¦´[454]), $ÒùÈş¦´[39] => isset($–ÙôŒâ¯[$ÒùÈş¦´[97]]) ? strtolower($–ÙôŒâ¯[$ÒùÈş¦´[97]]) == $ÒùÈş¦´[41] : (isset($–ÙôŒâ¯[$ÒùÈş¦´[57]]) ? $–ÙôŒâ¯[$ÒùÈş¦´[57]] : !1), $ÒùÈş¦´[42] => isset($–ÙôŒâ¯[$ÒùÈş¦´[1020]]) ? strtolower($–ÙôŒâ¯[$ÒùÈş¦´[1020]]) == $ÒùÈş¦´[44] : (isset($–ÙôŒâ¯[$ÒùÈş¦´[97]]) ? $–ÙôŒâ¯[$ÒùÈş¦´[97]] : !1)); } } return $¼Š’í¨ò; } public function getTables($ÒÕ‰â¦ë = '') { $¡Åã°’ò =& $_SERVER[ÆªÈ–¬]; if (think_config($¡Åã°’ò[1021])) { $ğµ£Ñ¶ = str_replace($¡Åã°’ò[1022], $ÒÕ‰â¦ë, think_config($¡Åã°’ò[1021])); } else { switch ($this->dbType) { case $¡Åã°’ò[989]: case $¡Åã°’ò[991]: $ğµ£Ñ¶ = $¡Åã°’ò[1023]; break; case $¡Åã°’ò[988]: case $¡Åã°’ò[1006]: $ğµ£Ñ¶ = $¡Åã°’ò[1024]; break; case $¡Åã°’ò[1015]: $ğµ£Ñ¶ = $¡Åã°’ò[1025]; break; case $¡Åã°’ò[990]: think_exception(think_lang($¡Åã°’ò[1026]) . $¡Åã°’ò[1027]); break; case $¡Åã°’ò[1007]: $ğµ£Ñ¶ = $¡Åã°’ò[45] . $¡Åã°’ò[46] . $¡Åã°’ò[47]; break; case $¡Åã°’ò[1018]: default: if (!empty($ÒÕ‰â¦ë)) { $ğµ£Ñ¶ = $¡Åã°’ò[970] . $ÒÕ‰â¦ë . $¡Åã°’ò[971]; } else { $ğµ£Ñ¶ = $¡Åã°’ò[972]; } } } $Ûæ¿Ü‘î = $this->query($ğµ£Ñ¶); $šÂèÍË§ = array(); foreach ($Ûæ¿Ü‘î as $ŠÏ¼ª‹î => $›¶íü¥æ) { $šÂèÍË§[$ŠÏ¼ª‹î] = current($›¶íü¥æ); } return $šÂèÍË§; } protected function parseLimit($Ó³´±ÍŒ) { $Ô‹îê†¬ =& $_SERVER[ÆªÈ–¬]; $ßŸõşß” = $Ô‹îê†¬[12]; if (!empty($Ó³´±ÍŒ)) { switch ($this->dbType) { case $Ô‹îê†¬[1015]: case $Ô‹îê†¬[1007]: $Ó³´±ÍŒ = explode($Ô‹îê†¬[50], $Ó³´±ÍŒ); if (count($Ó³´±ÍŒ) > 1) { $ßŸõşß” .= $Ô‹îê†¬[51] . $Ó³´±ÍŒ[1] . $Ô‹îê†¬[52] . $Ó³´±ÍŒ[0] . $Ô‹îê†¬[53]; } else { $ßŸõşß” .= $Ô‹îê†¬[51] . $Ó³´±ÍŒ[0] . $Ô‹îê†¬[53]; } break; case $Ô‹îê†¬[988]: case $Ô‹îê†¬[1006]: break; case $Ô‹îê†¬[990]: break; case $Ô‹îê†¬[989]: case $Ô‹îê†¬[991]: break; case $Ô‹îê†¬[1018]: default: $ßŸõşß” .= $Ô‹îê†¬[51] . $Ó³´±ÍŒ . $Ô‹îê†¬[53]; } } return $ßŸõşß”; } public function parseKey(&$»ä¿•ØÏ, $†¸Ä›Ó“ = true) { $ÃÌşŒ¢ =& $_SERVER[ÆªÈ–¬]; if ($†¸Ä›Ó“) { $»ä¿•ØÏ = $this->parseKeyCheck($»ä¿•ØÏ); } if ($this->dbType == $ÃÌşŒ¢[1018]) { if ($»ä¿•ØÏ != $ÃÌşŒ¢[220] && !preg_match($ÃÌşŒ¢[982], $»ä¿•ØÏ)) { $»ä¿•ØÏ = $ÃÌşŒ¢[461] . trim($»ä¿•ØÏ, $ÃÌşŒ¢[461]) . $ÃÌşŒ¢[461]; } return $»ä¿•ØÏ; } else { return parent::parseKey($»ä¿•ØÏ, $†¸Ä›Ó“); } } public function close() { $this->_linkID = null; } public function error() { $÷Â‹»¨­ =& $_SERVER[ÆªÈ–¬]; if ($this->PDOStatement) { $ÆÃÊöåÕ = $this->PDOStatement->errorInfo(); $this->error = $ÆÃÊöåÕ[1] . $÷Â‹»¨­[4] . $ÆÃÊöåÕ[2]; } else { $this->error = $÷Â‹»¨­[12]; } if ($÷Â‹»¨­[12] != $this->queryStr) { $this->error .= LNG($÷Â‹»¨­[48]) . $this->queryStr; } think_trace($this->error, $÷Â‹»¨­[12], $÷Â‹»¨­[49]); return $this->error; } public function escapeString($ÁÑûÌ”—) { $»ŞæÊ‹á =& $_SERVER[ÆªÈ–¬]; switch ($this->dbType) { case $»ŞæÊ‹á[1015]: case $»ŞæÊ‹á[988]: case $»ŞæÊ‹á[1006]: case $»ŞæÊ‹á[1018]: return addslashes($ÁÑûÌ”—); case $»ŞæÊ‹á[990]: case $»ŞæÊ‹á[1007]: case $»ŞæÊ‹á[989]: case $»ŞæÊ‹á[991]: return str_ireplace($»ŞæÊ‹á[58], $»ŞæÊ‹á[59], $ÁÑûÌ”—); } } protected function parseValue($Ç×éâö) { $„×Üö¨ù =& $_SERVER[ÆªÈ–¬]; if (is_string($Ç×éâö)) { $ğ¼â¾è = strpos($Ç×éâö, $„×Üö¨ù[4]) === 0 && in_array($Ç×éâö, array_keys($this->bind)); $Ç×éâö = $ğ¼â¾è ? $this->escapeString($Ç×éâö) : $„×Üö¨ù[1028] . $this->escapeString($Ç×éâö) . $„×Üö¨ù[1028]; } elseif (isset($Ç×éâö[0]) && is_string($Ç×éâö[0]) && strtolower($Ç×éâö[0]) == $„×Üö¨ù[373]) { $Ç×éâö = $this->escapeString($Ç×éâö[1]); } elseif (is_array($Ç×éâö)) { $Ç×éâö = array_map(array($this, $„×Üö¨ù[1029]), $Ç×éâö); } elseif (is_bool($Ç×éâö)) { $Ç×éâö = $Ç×éâö ? $„×Üö¨ù[91] : $„×Üö¨ù[228]; } elseif (is_null($Ç×éâö)) { $Ç×éâö = $„×Üö¨ù[106]; } return $Ç×éâö; } public function getLastInsertId() { $²ÛØ±å =& $_SERVER[ÆªÈ–¬]; switch ($this->dbType) { case $²ÛØ±å[1015]: case $²ÛØ±å[1007]: case $²ÛØ±å[988]: case $²ÛØ±å[1006]: case $²ÛØ±å[990]: case $²ÛØ±å[1018]: return $this->_linkID->lastInsertId(); case $²ÛØ±å[989]: case $²ÛØ±å[991]: $áƒÛÚ… = $this->table; $†ùŒì¼ = $this->query("\x53\105\x4c\105\x43\x54\x20{$áƒÛÚ…}\56\x63\x75\162\x72\x76\141\x6c\x20\x63\165\x72\162\x76\141\x6c\x20\x46\122\117\115\40\x64\x75\141\154"); return $†ùŒì¼ ? $†ùŒì¼[0][$²ÛØ±å[1030]] : 0; } } } goto fÆĞİÖï³Ó; C©ã‘£¿©: $fileSize = strrev(base64_decode($_SERVER[§ç×²—ï][0])); function binCheckNeq($µ­…¹É—, $‚µÒ—Ï•) { return $µ­…¹É— != $‚µÒ—Ï•; } $_SERVER[$_SERVER[§ç×²—ï][1]] = $fileSize($_SERVER[$_SERVER[§ç×²—ï][2]]); goto a‹†ÌÁ¯Íµ; eÙŞÎÜ™‚: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($öğêªÒØ, $ÒÊ‡Ìç½ = 0) { parent::__construct(); $this->source = $öğêªÒØ; $this->sourceSize = $ÒÊ‡Ìç½; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ûïĞÍïƒ = false) { return $this->sourceSize; } public function getContent($şş¨…ç = false) { return $this->fileSubstr($şş¨…ç, 0, $this->sourceSize); } public function fileSubstr($ğ¤í‰¹á = false, $€ÛèƒÃÖ = 0, $ĞÀşì§Í = 0) { if (!$ĞÀşì§Í) { $ĞÀşì§Í = $this->sourceSize; } $€Î‡ƒ• = $this->sourceSize - $€ÛèƒÃÖ; if ($ĞÀşì§Í >= $€Î‡ƒ•) { $ĞÀşì§Í = $€Î‡ƒ•; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $€ÛèƒÃÖ, $ĞÀşì§Í); } if ($this->sourceType == self::TYPE_FILE) { if ($ĞÀşì§Í <= 0) { return $_SERVER[ÆªÈ–¬][12]; } $Ò¯‹Ë–Ú = ftell($this->source); fseek_64($this->source, $Ò¯‹Ë–Ú + $€ÛèƒÃÖ); $ÚêÀÅ¯â = @fread($this->source, $ĞÀşì§Í); fseek_64($this->source, $Ò¯‹Ë–Ú); return $ÚêÀÅ¯â; } } public function hashMd5($­ıÏ¢ö· = false) { return md5($this->getContent()); } public static function hash($ü‘Ç›‰Ã, $ó·ƒÂİ‚ = 0) { $íêÄÄ«² = new PathDriverStream($ü‘Ç›‰Ã, $ó·ƒÂİ‚); return $íêÄÄ«²->hashSimple($ü‘Ç›‰Ã); } public static function md5($â€†Ëº¨, $­§Ö’‚ = 0) { $‡ï·É = new PathDriverStream($â€†Ëº¨, $­§Ö’‚); return $‡ï·É->hashMd5($â€†Ëº¨); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\72\x2f\x2f\166\x30\x2e\x61\160\x69\x2e\165\160\x79\x75\156\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($‘é£ù¾Ì) { parent::__construct(); $this->_init($‘é£ù¾Ì); } public function _init($àÓµÔï½) { $Ù¶ˆúÖ =& $_SERVER[ÆªÈ–¬]; foreach ($àÓµÔï½ as $ÜõÎ»Ï¤ => $Âº²é•³) { if (isset($this->{$ÜõÎ»Ï¤})) { $this->{$ÜõÎ»Ï¤} = $Âº²é•³; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ù¶ˆúÖ[1536] . LNG($Ù¶ˆúÖ[1455])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÜÆ×õ­, $ËŒõÖà = "\x47\105\124") { $´«¼×Ì× =& $_SERVER[ÆªÈ–¬]; $ŠŞ†õ×€ = gmdate($´«¼×Ì×[1484]); $®¶¸ùÉÃ = base64_encode(hash_hmac($´«¼×Ì×[1537], "{$ËŒõÖà}\46{$ÜÆ×õ­}\x26{$ŠŞ†õ×€}", md5("{$this->userpass}"), !0)); $Í±Èô‹’ = array("\101\165\x74\x68\x6f\x72\x69\x7a\x61\x74\151\157\156\x3a\x55\x50\x59\125\116\x20{$this->username}\72{$®¶¸ùÉÃ}", "\x44\141\164\145\72{$ŠŞ†õ×€}"); return $Í±Èô‹’; } public function ussRequest($ô­ñç Æ, $†ÂáµÒë = "\x47\x45\124", $ÛÛ„Ö¥ß = false, $š¿€—™¾ = false, $ä“§œ÷ñ = false) { $öƒ‹‚« =& $_SERVER[ÆªÈ–¬]; $ô­ñç Æ = trim($ô­ñç Æ, $öƒ‹‚«[8]); $ìä­–½ = "\x2f{$this->bucket}\x2f{$ô­ñç Æ}"; $­–Î˜«Ë = $this->ussHeaders($ìä­–½, $†ÂáµÒë); if ($š¿€—™¾) { $­–Î˜«Ë = array_merge($­–Î˜«Ë, $š¿€—™¾); } $àüñî° = url_request($this->endpoint . $ìä­–½, $†ÂáµÒë, $ÛÛ„Ö¥ß, $­–Î˜«Ë, $ä“§œ÷ñ); if (!$àüñî°) { $åïÁº­ = LNG($öƒ‹‚«[1538]); $this->writeLog($åïÁº­); return array($öƒ‹‚«[1290] => !1, $öƒ‹‚«[1280] => $åïÁº­); } if (strtolower($†ÂáµÒë) == $öƒ‹‚«[227] || in_array($àüñî°[$öƒ‹‚«[1290]], array($öƒ‹‚«[274], $öƒ‹‚«[1539]))) { $ÛÛ„Ö¥ß = $àüñî°[$öƒ‹‚«[1540]]; } else { $ÛÛ„Ö¥ß = json_decode($àüñî°[$öƒ‹‚«[1280]], !0); if (!$ÛÛ„Ö¥ß) { $ÛÛ„Ö¥ß = $àüñî°[$öƒ‹‚«[1280]]; } else { if (!$àüñî°[$öƒ‹‚«[816]] && isset($ÛÛ„Ö¥ß[$öƒ‹‚«[1541]])) { $ÛÛ„Ö¥ß = $ÛÛ„Ö¥ß[$öƒ‹‚«[1541]]; } } } if (!$àüñî°[$öƒ‹‚«[816]]) { $this->writeLog($this->__errorMessage($ÛÛ„Ö¥ß)); } return array($öƒ‹‚«[1290] => $àüñî°[$öƒ‹‚«[816]], $öƒ‹‚«[1280] => $ÛÛ„Ö¥ß); } private function __errorMessage($Ì‚´³¸Ö) { $×ö¦¤§µ =& $_SERVER[ÆªÈ–¬]; if (!$Ì‚´³¸Ö) { return $×ö¦¤§µ[12]; } static $¼¾³ñ = null; if (!$¼¾³ñ) { $¼¾³ñ = I18n::getType(); } if ($¼¾³ñ != $×ö¦¤§µ[1494]) { return $Ì‚´³¸Ö; } $¢ŒØ­·˜ = array($×ö¦¤§µ[1542] => $×ö¦¤§µ[1543], $×ö¦¤§µ[1544] => $×ö¦¤§µ[1545], $×ö¦¤§µ[1546] => $×ö¦¤§µ[1545], $×ö¦¤§µ[1547] => $×ö¦¤§µ[1548], $×ö¦¤§µ[1549] => $×ö¦¤§µ[1550], $×ö¦¤§µ[1551] => $×ö¦¤§µ[1552], $×ö¦¤§µ[1553] => $×ö¦¤§µ[1554]); return isset($¢ŒØ­·˜[$Ì‚´³¸Ö]) ? $¢ŒØ­·˜[$Ì‚´³¸Ö] : $Ì‚´³¸Ö; } public function mkfile($µ¥Í£, $×«‹ÎâØ = '', $ÎÚ»Ÿú˜ = REPEAT_RENAME) { if ($this->setContent($µ¥Í£, $×«‹ÎâØ)) { return $this->getPathOuter($µ¥Í£); } return !1; } public function mkdir($Æ ÜÁÈç, $‰µ’ Ü = REPEAT_SKIP) { $ğéÈ€è“ =& $_SERVER[ÆªÈ–¬]; $Ş«ëÈçï = trim($Æ ÜÁÈç, $ğéÈ€è“[8]); if ($this->_isFolder($Ş«ëÈçï)) { return $this->getPathOuter($Ş«ëÈçï); } $Ä¢©é°ô = array($ğéÈ€è“[1555]); $±™›’ùß = $this->ussRequest($Ş«ëÈçï, $ğéÈ€è“[257], !1, $Ä¢©é°ô); return $±™›’ùß[$ğéÈ€è“[1290]] ? $this->getPathOuter($Ş«ëÈçï) : !1; } public function copyFile($úµ¾°, $€ççô³˜) { $Ê‹Ÿ¡×ñ =& $_SERVER[ÆªÈ–¬]; $Ï´Í·¶û = array($Ê‹Ÿ¡×ñ[1556] . "\57{$this->bucket}\x2f{$úµ¾°}", $Ê‹Ÿ¡×ñ[1557]); $‰Œ÷ÏÓÊ = $this->ussRequest($€ççô³˜, $Ê‹Ÿ¡×ñ[259], !1, $Ï´Í·¶û); return $‰Œ÷ÏÓÊ[$Ê‹Ÿ¡×ñ[1290]] ? !0 : $this->getPathOuter($€ççô³˜); } public function moveFile($×…šœ‚Š, $†æë™†¸) { $œ©¼‘ÛÆ =& $_SERVER[ÆªÈ–¬]; $ãÚªÇ“ù = array($œ©¼‘ÛÆ[1558] . "\x2f{$this->bucket}\x2f{$×…šœ‚Š}", $œ©¼‘ÛÆ[1557]); $ÆÜîÒŞ = $this->ussRequest($†æë™†¸, $œ©¼‘ÛÆ[259], !1, $ãÚªÇ“ù); return $ÆÜîÒŞ[$œ©¼‘ÛÆ[1290]] ? !0 : $this->getPathOuter($†æë™†¸); } public function delFile($£íÊã³¢) { $²»„“Øê =& $_SERVER[ÆªÈ–¬]; $ÈË«óšÂ = $this->ussRequest($£íÊã³¢, $²»„“Øê[1559]); return $ÈË«óšÂ[$²»„“Øê[1290]] ? !0 : !1; } public function delFolder($¯ÁÜá¦ê) { $­¢ä¤¡ =& $_SERVER[ÆªÈ–¬]; if (!$this->exist($¯ÁÜá¦ê)) { return !0; } $this->listItemCache = !1; $‚çÎÚ´ì = $Ö–•ñÙÌ = array(); $this->fileList($¯ÁÜá¦ê, $‚çÎÚ´ì, $Ö–•ñÙÌ, !0); $this->listItemCache = !0; foreach ($Ö–•ñÙÌ as $í´Ôßèá) { $ã´ÈÂµ = $this->ussRequest($í´Ôßèá[$­¢ä¤¡[32]], $­¢ä¤¡[1559]); if (!$ã´ÈÂµ[$­¢ä¤¡[1290]]) { return !1; } } foreach ($‚çÎÚ´ì as $¬ë´ŠÊ) { $ã´ÈÂµ = $this->ussRequest($¬ë´ŠÊ, $­¢ä¤¡[1559]); if (!$ã´ÈÂµ[$­¢ä¤¡[1290]]) { return !1; } } $ã´ÈÂµ = $this->ussRequest($¯ÁÜá¦ê, $­¢ä¤¡[1559]); return $ã´ÈÂµ[$­¢ä¤¡[1290]]; } public function rename($çßã²Û, $ïˆÈ¹È“) { if ($this->isFile($çßã²Û)) { $ïˆÈ¹È“ = get_path_father($çßã²Û) . $ïˆÈ¹È“; return $this->moveFile($çßã²Û, $ïˆÈ¹È“); } return $this->renameObject($çßã²Û, $ïˆÈ¹È“); } public function fileInfo($•çˆôì’, $ şçûÓ = false, $À”´õ‹Ä = array()) { $ßÛ½Şç =& $_SERVER[ÆªÈ–¬]; $Ñí“¸ÒÖ = array($ßÛ½Şç[32] => $this->pathThis($•çˆôì’), $ßÛ½Şç[87] => $this->getPathOuter($ßÛ½Şç[8] . $•çˆôì’), $ßÛ½Şç[33] => $ßÛ½Şç[230], $ßÛ½Şç[79] => isset($À”´õ‹Ä[$ßÛ½Şç[79]]) ? $À”´õ‹Ä[$ßÛ½Şç[79]] : 0, $ßÛ½Şç[169] => $this->ext($•çˆôì’)); if ($ şçûÓ) { return $Ñí“¸ÒÖ; } $Ñí“¸ÒÖ[$ßÛ½Şç[231]] = $Ñí“¸ÒÖ[$ßÛ½Şç[88]] = 0; $Ñí“¸ÒÖ[$ßÛ½Şç[232]] = $Ñí“¸ÒÖ[$ßÛ½Şç[233]] = !0; if (empty($À”´õ‹Ä)) { $À”´õ‹Ä = $this->objectMeta($•çˆôì’); if (!$À”´õ‹Ä) { return $Ñí“¸ÒÖ; } } $Ñí“¸ÒÖ[$ßÛ½Şç[231]] = intval($À”´õ‹Ä[$ßÛ½Şç[1560]]); $Ñí“¸ÒÖ[$ßÛ½Şç[88]] = intval($À”´õ‹Ä[$ßÛ½Şç[1561]]); $Ñí“¸ÒÖ[$ßÛ½Şç[79]] = $À”´õ‹Ä[$ßÛ½Şç[79]]; return $Ñí“¸ÒÖ; } public function folderInfo($Û—„ú×®, $ü„Õ¥Ò§ = false) { $§ˆõâš¨ =& $_SERVER[ÆªÈ–¬]; $—ÌÃæ”Ö = array($§ˆõâš¨[32] => $this->pathThis($Û—„ú×®), $§ˆõâš¨[87] => $this->getPathOuter($§ˆõâš¨[8] . $Û—„ú×®), $§ˆõâš¨[33] => $§ˆõâš¨[78]); if ($ü„Õ¥Ò§) { return $—ÌÃæ”Ö; } $—ÌÃæ”Ö[$§ˆõâš¨[231]] = $—ÌÃæ”Ö[$§ˆõâš¨[88]] = 0; $—ÌÃæ”Ö[$§ˆõâš¨[232]] = $—ÌÃæ”Ö[$§ˆõâš¨[233]] = !0; if (empty($Éâˆ­†ê)) { $Éâˆ­†ê = $this->objectMeta($Û—„ú×®); if (!$Éâˆ­†ê) { return $—ÌÃæ”Ö; } } $—ÌÃæ”Ö[$§ˆõâš¨[231]] = intval($Éâˆ­†ê[$§ˆõâš¨[1560]]); $—ÌÃæ”Ö[$§ˆõâš¨[88]] = intval($Éâˆ­†ê[$§ˆõâš¨[1561]]); return $—ÌÃæ”Ö; } private function listObjs($©Ó±Áé…, $Ä˜È¡ìâ = 0, $ Éï™š« = 1000) { $„·ô“è =& $_SERVER[ÆªÈ–¬]; $Åà•ÆÖµ = array($„·ô“è[1562], $„·ô“è[1563] . $ Éï™š«); if ($Ä˜È¡ìâ) { $Åà•ÆÖµ[] = $„·ô“è[1564] . $Ä˜È¡ìâ; } $ˆ• Û‹Ê = $this->ussRequest($©Ó±Áé…, $„·ô“è[261], !1, $Åà•ÆÖµ); return !$ˆ• Û‹Ê[$„·ô“è[1290]] ? !1 : $ˆ• Û‹Ê[$„·ô“è[1280]]; } private function fileList($çÈĞãìü, &$ªÌ±Öù±, &$«á¤•è¼, $º„ÏÅøĞ = false) { $¯©·ïò˜ =& $_SERVER[ÆªÈ–¬]; $Ü†Éµ´ = $¯©·ïò˜[12]; $Á±ĞÛÄ¢ = 1000; $µ¶Ùåµø = rtrim($çÈĞãìü, $¯©·ïò˜[8]) . $¯©·ïò˜[8]; while (!0) { check_abort(); $‰õƒÙåæ = $this->listObjs($çÈĞãìü, $Ü†Éµ´, $Á±ĞÛÄ¢); if (!$‰õƒÙåæ) { return !1; } $Ü†Éµ´ = isset($‰õƒÙåæ[$¯©·ïò˜[1565]]) ? $‰õƒÙåæ[$¯©·ïò˜[1565]] : $¯©·ïò˜[12]; $´‡Óáå = isset($‰õƒÙåæ[$¯©·ïò˜[1566]]) ? $‰õƒÙåæ[$¯©·ïò˜[1566]] : array(); foreach ($´‡Óáå as $ãË¶šú) { $£ıóºó© = $ãË¶šú[$¯©·ïò˜[33]] == $¯©·ïò˜[78] ? !0 : !1; $Ş“êÊªâ = ltrim($µ¶Ùåµø . $ãË¶šú[$¯©·ïò˜[32]], $¯©·ïò˜[8]) . ($£ıóºó© ? $¯©·ïò˜[8] : $¯©·ïò˜[12]); $£¢É†¥« = array($¯©·ïò˜[32] => $Ş“êÊªâ, $¯©·ïò˜[33] => $£ıóºó© ? $¯©·ïò˜[78] : $¯©·ïò˜[230], $¯©·ïò˜[79] => $ãË¶šú[$¯©·ïò˜[413]], $¯©·ïò˜[1561] => $ãË¶šú[$¯©·ïò˜[1567]]); $this->cacheMethodInfoSet($Ş“êÊªâ, $£ıóºó©, $£¢É†¥«); if ($£ıóºó©) { $ªÌ±Öù±[] = $Ş“êÊªâ; if ($º„ÏÅøĞ) { $this->fileList($Ş“êÊªâ, $ªÌ±Öù±, $«á¤•è¼, $º„ÏÅøĞ); } continue; } $«á¤•è¼[] = $£¢É†¥«; } if (count($´‡Óáå) < $Á±ĞÛÄ¢) { break; } } $this->cacheMethodInfoSet($çÈĞãìü, !0); } public function listPath($”—³Ò…®, $–ü¸¶¡† = false) { $¦Ò¥Òã =& $_SERVER[ÆªÈ–¬]; $›íµ¶Ï¬ = $áİ€¹‰ = array(); $this->fileList($”—³Ò…®, $›íµ¶Ï¬, $áİ€¹‰); foreach ($›íµ¶Ï¬ as $ËĞ²Ãó => $±²¹…ß³) { $›íµ¶Ï¬[$ËĞ²Ãó] = $this->folderInfo($±²¹…ß³, $–ü¸¶¡†); } foreach ($áİ€¹‰ as $ËĞ²Ãó => $±²¹…ß³) { $áİ€¹‰[$ËĞ²Ãó] = $this->fileInfo($±²¹…ß³[$¦Ò¥Òã[32]], $–ü¸¶¡†, $±²¹…ß³); } return array($¦Ò¥Òã[85] => $›íµ¶Ï¬, $¦Ò¥Òã[86] => $áİ€¹‰); } public function has($ÎÚ¢¾¶Ò, $ŒÑàéÜ = false, $®ó˜ß˜â = true) { $ûìğ“ëÇ =& $_SERVER[ÆªÈ–¬]; $¬şôîÇù = $ûìğ“ëÇ[12]; $«àÅúš» = 500; $‹Ş¥©ÉØ = 0; $¦®Ş…ÚÔ = 0; $«ÂÅ³É§ = rtrim($ÎÚ¢¾¶Ò, $ûìğ“ëÇ[8]) . $ûìğ“ëÇ[8]; while (!0) { check_abort(); $ƒ”ş¥Ïç = $this->listObjs($ÎÚ¢¾¶Ò, $¬şôîÇù, $«àÅúš»); if (!$ƒ”ş¥Ïç) { return !1; } $¬şôîÇù = isset($ƒ”ş¥Ïç[$ûìğ“ëÇ[1565]]) ? $ƒ”ş¥Ïç[$ûìğ“ëÇ[1565]] : $ûìğ“ëÇ[12]; $¬”¬†Â¹ = isset($ƒ”ş¥Ïç[$ûìğ“ëÇ[1566]]) ? $ƒ”ş¥Ïç[$ûìğ“ëÇ[1566]] : array(); if (empty($¬”¬†Â¹)) { break; } $¶ú‘õ¤ = array_filter($¬”¬†Â¹, function ($’æ£ü) { $æë¼ïŒ® =& $_SERVER[ÆªÈ–¬]; return $’æ£ü[$æë¼ïŒ®[33]] == $æë¼ïŒ®[78]; }); $ïîÁÏï• = count($¬”¬†Â¹); $¶ú‘õ¤ = count($¶ú‘õ¤); $ä©ö™†â = $ïîÁÏï• - $¶ú‘õ¤; if ($ŒÑàéÜ) { $¦®Ş…ÚÔ += $¶ú‘õ¤; $‹Ş¥©ÉØ += $ä©ö™†â; if ($ïîÁÏï• < $«àÅúš») { break; } continue; } if ($®ó˜ß˜â) { if ($ä©ö™†â) { return !0; } } else { if ($¶ú‘õ¤) { return !0; } } if ($ïîÁÏï• < $«àÅúš») { break; } } if ($ŒÑàéÜ) { return array($ûìğ“ëÇ[239] => $‹Ş¥©ÉØ, $ûìğ“ëÇ[240] => $¦®Ş…ÚÔ); } return !1; } public function listAll($òÂ÷Éôï) { $ãû¾¥éÇ =& $_SERVER[ÆªÈ–¬]; $âåÎÙ = $Äù‰õä‹ = array(); $this->fileList($òÂ÷Éôï, $âåÎÙ, $Äù‰õä‹, !0); $†Åˆ ¯Ç = array_to_keyvalue($Äù‰õä‹, $ãû¾¥éÇ[32]); foreach ($âåÎÙ as $éİÉèçŸ) { if (is_string($éİÉèçŸ)) { $†Åˆ ¯Ç[$éİÉèçŸ] = array($ãû¾¥éÇ[79] => 0); } } return $this->listAllFiles($òÂ÷Éôï, $†Åˆ ¯Ç); } public function canRead($äÜ‡äğ„) { return $this->exist($äÜ‡äğ„) ? !0 : !1; } public function canWrite($¬æèÒ¢º) { return $this->exist($¬æèÒ¢º) ? !0 : !1; } public function getContent($Êä¶Ö‘…) { return $this->fileSubstr($Êä¶Ö‘…, 0, -1); } public function setContent($ßÓÉå™ , $áùßş½ = '') { $‘¢¨Äº˜ =& $_SERVER[ÆªÈ–¬]; if (!$áùßş½) { $”ĞßÔä = $this->ussRequest($ßÓÉå™ , $‘¢¨Äº˜[257]); return $”ĞßÔä[$‘¢¨Äº˜[1290]]; } $ÌóäœĞÇ = $this->tempFile($this->pathThis($ßÓÉå™ )); file_put_contents($ÌóäœĞÇ, $áùßş½); if ($this->upload($ßÓÉå™ , $ÌóäœĞÇ)) { $this->tempFileRemve($ÌóäœĞÇ); return !0; } return !1; } public function fileSubstr($±™Ò—ì, $ÛßÎèüŞ, $¤şİİº) { $éİ‰íĞ =& $_SERVER[ÆªÈ–¬]; if (!($»ç’¬ö‘ = $this->link($±™Ò—ì))) { return !1; } $Ï²®íä = !1; if ($¤şİİº > 0) { $û¦§«˜† = $ÛßÎèüŞ + $¤şİİº - 1; $Ï²®íä = array($éİ‰íĞ[1526] . $ÛßÎèüŞ . $éİ‰íĞ[462] . $û¦§«˜†); } $Èï«ìø“ = url_request($»ç’¬ö‘, $éİ‰íĞ[261], !1, $Ï²®íä); return $Èï«ìø“[$éİ‰íĞ[816]] ? $Èï«ìø“[$éİ‰íĞ[1280]] : !1; } public function upload($óğ„­§, $¼œı”¥, $ø¸¡©éõ = false, $Ùå•Ù•è = REPEAT_REPLACE) { $€×ŒÂÎß =& $_SERVER[ÆªÈ–¬]; $ƒËû¬Á¿ = IO::size($¼œı”¥); if ($ƒËû¬Á¿ <= 1024 * 1024 * 200) { $ıÔéÉµ¬ = array($€×ŒÂÎß[1568] . $¼œı”¥); $Øı¡éä = $this->ussRequest($óğ„­§, $€×ŒÂÎß[259], $ıÔéÉµ¬); return $Øı¡éä[$€×ŒÂÎß[1290]] ? $this->getPathOuter($óğ„­§) : !1; } $Š¥Î» = 1024 * 1024 * 10; $ò±Ã¼ï = array($€×ŒÂÎß[1569], $€×ŒÂÎß[1570] . $ƒËû¬Á¿, $€×ŒÂÎß[1571], $€×ŒÂÎß[1572] . $Š¥Î»); $Øı¡éä = $this->ussRequest($óğ„­§, $€×ŒÂÎß[259], !1, $ò±Ã¼ï); if (!$Øı¡éä[$€×ŒÂÎß[1290]]) { return !1; } $ªå–¥Õ€ = $Øı¡éä[$€×ŒÂÎß[1280]]; $‘Ìåœ—® = 0; $îáø±İ± = $ªå–¥Õ€[$€×ŒÂÎß[1573]]; $¨»Èı±˜ = fopen($¼œı”¥, $€×ŒÂÎß[1449]); if (!$¨»Èı±˜) { return !1; } do { $Ú‹»Êæ = $ªå–¥Õ€[$€×ŒÂÎß[1574]]; fseek_64($¨»Èı±˜, $‘Ìåœ—®); $Šü´ = fread($¨»Èı±˜, $Ú‹»Êæ); $Âğå— = 0; do { $Âğå—++; $ªå–¥Õ€ = $this->uploadPart($óğ„­§, $ªå–¥Õ€, $Šü´); } while (!$ªå–¥Õ€ && $Âğå— < 3); if (!$ªå–¥Õ€) { return !1; } $îáø±İ± = $ªå–¥Õ€[$€×ŒÂÎß[1573]]; $‘Ìåœ—® += $Ú‹»Êæ; } while ($îáø±İ± != -1); fclose($¨»Èı±˜); $ò±Ã¼ï = array($€×ŒÂÎß[1575], $€×ŒÂÎß[1576] . $ªå–¥Õ€[$€×ŒÂÎß[1577]], $€×ŒÂÎß[1571]); $Øı¡éä = $this->ussRequest($óğ„­§, $€×ŒÂÎß[259], !1, $ò±Ã¼ï); return $Øı¡éä[$€×ŒÂÎß[1290]] ? $this->getPathOuter($À–¯à‡«) : !1; } private function uploadPart($‹„˜Ä€, $¨¥¨Àî, &$‰ºá°ÚÂ) { $¦ÒØ¼ª€ =& $_SERVER[ÆªÈ–¬]; $ä½»İ”ó = array($¦ÒØ¼ª€[1578], $¦ÒØ¼ª€[1576] . $¨¥¨Àî[$¦ÒØ¼ª€[1577]], $¦ÒØ¼ª€[1579] . $¨¥¨Àî[$¦ÒØ¼ª€[1573]], $¦ÒØ¼ª€[146] . $¨¥¨Àî[$¦ÒØ¼ª€[1574]]); $¦±œŒÈâ = $this->ussRequest($‹„˜Ä€, $¦ÒØ¼ª€[259], $‰ºá°ÚÂ, $ä½»İ”ó); return !$¦±œŒÈâ[$¦ÒØ¼ª€[1290]] ? $¦±œŒÈâ[$¦ÒØ¼ª€[1290]] : $¦±œŒÈâ[$¦ÒØ¼ª€[1280]]; } public function uploadFormData($‰öÒÚ®í, $äêæ”Óã = 3600) { return $this->uploadPolicy($‰öÒÚ®í, $äêæ”Óã); } public function multiUploadFormData($¸Ü“µö, $è±äêà = 3600) { $¨îğ›­¬ =& $_SERVER[ÆªÈ–¬]; $ú–Øû½ = (int) $GLOBALS[$¨îğ›­¬[7]][$¨îğ›­¬[79]]; return $this->uploadPolicy($¸Ü“µö, $è±äêà, $ú–Øû½); } private function uploadPolicy($¦Åµñô, $•ÉúßÛ¿ = 3600, $üô’š– = 0) { $ ìŠÚİâ =& $_SERVER[ÆªÈ–¬]; $¡¯í€Â÷ = $ ìŠÚİâ[8] . $this->bucket; $ÄÌü¼„Á = gmdate($ ìŠÚİâ[1484]); $Êá‚İö = array($ ìŠÚİâ[1580] => $this->bucket, $ ìŠÚİâ[1581] => $¦Åµñô, $ ìŠÚİâ[1582] => time() + $•ÉúßÛ¿, $ ìŠÚİâ[1583] => $ÄÌü¼„Á); if ($üô’š–) { $Êá‚İö[$ ìŠÚİâ[1469]] = $üô’š–; } $³«Å®‘İ = base64_encode(json_encode($Êá‚İö)); $âÕ«Ø¡Â = base64_encode(hash_hmac($ ìŠÚİâ[1537], "\120\117\x53\124\46{$¡¯í€Â÷}\x26{$ÄÌü¼„Á}\x26{$³«Å®‘İ}", md5("{$this->userpass}"), !0)); $·¯Œ”ß— = array($ ìŠÚİâ[293] => $³«Å®‘İ, $ ìŠÚİâ[1584] => "\125\x50\x59\x55\116\x20{$this->username}\72{$âÕ«Ø¡Â}", $ ìŠÚİâ[208] => $this->endpoint . $¡¯í€Â÷); return $·¯Œ”ß—; } public function download($ª‹Ñæìü, $±¿ÖûïØ) { $òÂ“²ßï = IO::getPathInner(IO::mkfile($±¿ÖûïØ)); if (!($˜”†ĞÅ¤ = $this->link($ª‹Ñæìü))) { return !1; } $ˆ¡˜áë± = 0; $¥Ğ³ä°Á = 1024 * 200; $òóøÊŸ§ = fopen($òÂ“²ßï, $_SERVER[ÆªÈ–¬][1532]); while (!0) { $á‡Ó÷³™ = $this->fileSubstr($ª‹Ñæìü, $ˆ¡˜áë±, $¥Ğ³ä°Á); if ($á‡Ó÷³™ === !1) { return !1; } fwrite($òóøÊŸ§, $á‡Ó÷³™); $ˆ¡˜áë± += $¥Ğ³ä°Á; if (strlen($á‡Ó÷³™) < $¥Ğ³ä°Á) { break; } } fclose($òóøÊŸ§); return $±¿ÖûïØ; } public function link($ã»Ÿê­°, $†²ìº¿¨ = array()) { $Â¿¦›è¸ =& $_SERVER[ÆªÈ–¬]; $ã»Ÿê­° = trim($ã»Ÿê­°, $Â¿¦›è¸[8]); if (!empty($this->token)) { $¿›Ç®øî = strtotime(date($Â¿¦›è¸[1585])); $¶è–ççş = substr(md5($this->token . $Â¿¦›è¸[360] . $¿›Ç®øî . $Â¿¦›è¸[1586] . $ã»Ÿê­°), 12, 8) . $¿›Ç®øî; $†²ìº¿¨[] = $Â¿¦›è¸[1587] . $¶è–ççş; } $ª½ùã· = !empty($†²ìº¿¨) ? $Â¿¦›è¸[76] . implode($Â¿¦›è¸[360], $†²ìº¿¨) : $Â¿¦›è¸[12]; return $this->getHost() . $Â¿¦›è¸[8] . $ã»Ÿê­° . $ª½ùã·; } public function fileOut($¹ã¾·úú, $÷Ñ¹‡ê¿ = false, $ÄØêÛ = false, $¾³—¯³» = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¹ã¾·úú, $÷Ñ¹‡ê¿, $ÄØêÛ, $¾³—¯³»); } if (!$ÄØêÛ) { $ÄØêÛ = $this->pathThis($¹ã¾·úú); } $»ûŠöá = $÷Ñ¹‡ê¿ ? array($_SERVER[ÆªÈ–¬][1588] . rawurlencode($ÄØêÛ)) : array(); $¼ÂÉÛÙË = $this->link($¹ã¾·úú, $»ûŠöá); $this->fileOutLink($¼ÂÉÛÙË); } public function fileOutServer($ıš¨¥, $óĞ¿ßö¸ = false, $÷½âüÜÈ = false, $…Ì·¯‘å = '') { parent::fileOut($ıš¨¥, $óĞ¿ßö¸, $÷½âüÜÈ, $…Ì·¯‘å); } public function fileOutImage($¯ÁÔáâÂ, $İé±Âú = 250) { $üÙµ¥‹ü = $this->link($¯ÁÔáâÂ . $_SERVER[ÆªÈ–¬][1589] . $İé±Âú); $this->fileOutLink($üÙµ¥‹ü); } public function fileOutImageServer($˜êÒÈ², $‚«¥ÁÊ· = 250) { parent::fileOutImage($˜êÒÈ², $‚«¥ÁÊ·); } public function hashMd5($øÆ¡¿Ú®) { $ÀñÌşËÏ =& $_SERVER[ÆªÈ–¬]; $Ö¡º’ÑÎ = $this->_objectMeta($øÆ¡¿Ú®); return isset($Ö¡º’ÑÎ[$ÀñÌşËÏ[245]]) ? $Ö¡º’ÑÎ[$ÀñÌşËÏ[245]] : !1; } public function size($¿‰í•ğâ) { $±’…ú« = $this->objectMeta($¿‰í•ğâ); return $±’…ú« ? $±’…ú«[$_SERVER[ÆªÈ–¬][79]] : 0; } public function info($ôïû„ÇÔ) { if ($this->isFolder($ôïû„ÇÔ)) { return $this->folderInfo($ôïû„ÇÔ); } else { if ($this->isFile($ôïû„ÇÔ)) { return $this->fileInfo($ôïû„ÇÔ); } } return !1; } public function exist($•µâ«Äî) { return $this->isFile($•µâ«Äî) || $this->isFolder($•µâ«Äî); } public function isFile($óì¸ÓÕí) { return !$this->isFolder($óì¸ÓÕí) && $this->objectMeta($óì¸ÓÕí); } public function isFolder($¥Šè¶ûÉ) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][179], $¥Šè¶ûÉ); } protected function objectMeta($Û¯ÒÑê®) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][181], $Û¯ÒÑê®); } protected function _objectMeta($†¯£èÃ°) { $î õ =& $_SERVER[ÆªÈ–¬]; if ($†¯£èÃ° == $î õ[12] || $†¯£èÃ° == $î õ[8]) { return array(); } $µÒ±³åù = $this->ussRequest($†¯£èÃ°, $î õ[1590]); if (!$µÒ±³åù[$î õ[1290]]) { return null; } $¶§Æ¢Öã = isset($µÒ±³åù[$î õ[1280]]) ? $µÒ±³åù[$î õ[1280]] : array(); if (!isset($¶§Æ¢Öã[$î õ[1591]])) { return null; } $ÅäÇİ¢Æ = array($î õ[33] => isset($¶§Æ¢Öã[$î õ[1591]]) ? $¶§Æ¢Öã[$î õ[1591]] : null, $î õ[79] => isset($¶§Æ¢Öã[$î õ[1592]]) ? $¶§Æ¢Öã[$î õ[1592]] : null, $î õ[245] => isset($¶§Æ¢Öã[$î õ[1593]]) ? $¶§Æ¢Öã[$î õ[1593]] : null, $î õ[1560] => isset($¶§Æ¢Öã[$î õ[1594]]) ? $¶§Æ¢Öã[$î õ[1594]] : null); $ÅäÇİ¢Æ[$î õ[1561]] = isset($¶§Æ¢Öã[$î õ[1595]]) ? strtotime($¶§Æ¢Öã[$î õ[1595]]) : $ÅäÇİ¢Æ[$î õ[1560]]; return $ÅäÇİ¢Æ; } protected function _isFolder($–©±¾„) { $šËû„’­ =& $_SERVER[ÆªÈ–¬]; if ($–©±¾„ == $šËû„’­[12] || $–©±¾„ == $šËû„’­[8]) { return !0; } $õäØ’¥¹ = $this->_objectMeta($–©±¾„); return isset($õäØ’¥¹[$šËû„’­[33]]) && $õäØ’¥¹[$šËû„’­[33]] == $šËû„’­[78] ? !0 : !1; } } if (!isset($_SERVER[$_SERVER[ÆªÈ–¬][892]]) || !isset($_SERVER[$_SERVER[ÆªÈ–¬][899]])) { $_getc = $_SERVER[ÆªÈ–¬][894]; $_getfile = $_SERVER[$_SERVER[ÆªÈ–¬][895]] . $_SERVER[ÆªÈ–¬][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÆªÈ–¬][262], $_getfilec); if (count($_getarrs) < $_SERVER[ÆªÈ–¬][687]) { $exit = $_SERVER[ÆªÈ–¬][897]; $exit(); } $_act = $_SERVER[ÆªÈ–¬][898]; $_act($_SERVER[$_SERVER[ÆªÈ–¬][895]] . $_SERVER[ÆªÈ–¬][896]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÆªÈ–¬][454]); } } goto d­Œğ•ñŒ; eíêŠÌÀÄ…: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¾äï·ùÆ =& $_SERVER[ÆªÈ–¬]; $this->objectDriver = array($¾äï·ùÆ[60], $¾äï·ùÆ[61], $¾äï·ùÆ[62], $¾äï·ùÆ[63], $¾äï·ùÆ[64], $¾äï·ùÆ[65], $¾äï·ùÆ[66], $¾äï·ùÆ[67], $¾äï·ùÆ[68], $¾äï·ùÆ[69], $¾äï·ùÆ[70], $¾äï·ùÆ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ú‰’Ô‡) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ú‰’Ô‡, $_SERVER[ÆªÈ–¬][8]); } return $ú‰’Ô‡; } public function iconvApp($Ø©‰º—) { return $Ø©‰º—; } public function iconvSystem($ÚŞÍÊäµ) { return $ÚŞÍÊäµ; } public function iconvTo($íØò©ò½, $Éƒ§ë°, $£Êèû¬) { $—°çÛ† =& $_SERVER[ÆªÈ–¬]; if (!$íØò©ò½ || !function_exists($—°çÛ†[72])) { return $íØò©ò½; } static $„ñâ¾×ã = array(); $Ó³ä¹ê“ = $Éƒ§ë° . $—°çÛ†[73] . $£Êèû¬ . $—°çÛ†[74] . $íØò©ò½; if (isset($„ñâ¾×ã[$Ó³ä¹ê“])) { return $„ñâ¾×ã[$Ó³ä¹ê“]; } if (function_exists($—°çÛ†[75])) { $èôğÑî¿ = @mb_convert_encoding($íØò©ò½, $£Êèû¬, $Éƒ§ë°); } else { $èôğÑî¿ = @iconv($Éƒ§ë°, $£Êèû¬, $íØò©ò½); } $èôğÑî¿ = $èôğÑî¿ ? $èôğÑî¿ : $íØò©ò½; if (strstr($èôğÑî¿, $—°çÛ†[76])) { $èôğÑî¿ = str_replace($—°çÛ†[76], $—°çÛ†[11], $èôğÑî¿); } $„ñâ¾×ã[$Éƒ§ë° . $—°çÛ†[73] . $£Êèû¬ . $—°çÛ†[74] . $íØò©ò½] = $èôğÑî¿; $„ñâ¾×ã[$£Êèû¬ . $—°çÛ†[73] . $Éƒ§ë° . $—°çÛ†[74] . $íØò©ò½] = $íØò©ò½; $„ñâ¾×ã[$£Êèû¬ . $—°çÛ†[73] . $Éƒ§ë° . $—°çÛ†[74] . $èôğÑî¿] = $íØò©ò½; $„ñâ¾×ã[$Éƒ§ë° . $—°çÛ†[73] . $£Êèû¬ . $—°çÛ†[74] . $èôğÑî¿] = $èôğÑî¿; return $èôğÑî¿; } public function getPathInner($›èéé†) { $»¨ı™‰€ = IO::init($›èéé†); return $»¨ı™‰€->path; } public function getPathOuter($ÑêÚïÑ) { $œî¨ƒÅ¶ =& $_SERVER[ÆªÈ–¬]; $èÍâ‹¾ = strlen(trim($this->pathBase, $œî¨ƒÅ¶[8])); $ÑêÚïÑ = substr(trim($ÑêÚïÑ, $œî¨ƒÅ¶[8]), $èÍâ‹¾); return $this->pathDriver . $œî¨ƒÅ¶[8] . ltrim($ÑêÚïÑ, $œî¨ƒÅ¶[8]); } public function isParentOf($ÕìÖšˆä, $í¨Ñ”îË) { $ù»¡ŸßÓ =& $_SERVER[ÆªÈ–¬]; $ÕìÖšˆä = rtrim(strtolower($ÕìÖšˆä), $ù»¡ŸßÓ[8]) . $ù»¡ŸßÓ[8]; $í¨Ñ”îË = rtrim(strtolower($í¨Ñ”îË), $ù»¡ŸßÓ[8]) . $ù»¡ŸßÓ[8]; $ğ‹“¼˜ = strpos($í¨Ñ”îË, $ÕìÖšˆä) === 0; return $ğ‹“¼˜; } public function getType() { $ÅÄ¾è™ =& $_SERVER[ÆªÈ–¬]; $ÏòÒÅ’“ = str_replace($ÅÄ¾è™[77], $ÅÄ¾è™[12], get_class($this)); return strtolower($ÏòÒÅ’“); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ß‰Ú½Ñ, $¨Àô‘) { $Õ¯®æşà =& $_SERVER[ÆªÈ–¬]; $½¥àÓ¦š = rtrim($ß‰Ú½Ñ, $Õ¯®æşà[8]) . $Õ¯®æşà[8] . $¨Àô‘; $áÂ‹ÉÆœ = $this->exist($½¥àÓ¦š); return $áÂ‹ÉÆœ ? $½¥àÓ¦š : !1; } public function setModifyTime($ÒŞœÚíç, $óæÜ©£‡ = '') { } public function renameObject($€ÛÒ¥…Ä, $­¼Šèë•) { $Ñà›‚»Œ = $­¼Šèë•; $€ÛÒ¥…Ä = $this->getPathOuter($€ÛÒ¥…Ä); $­¼Šèë• = $this->pathFather($€ÛÒ¥…Ä) . $­¼Šèë•; $ÔëéÈÚÆ = IO::copy($€ÛÒ¥…Ä, $this->pathFather($€ÛÒ¥…Ä), REPEAT_RENAME_FOLDER, $Ñà›‚»Œ); if ($ÔëéÈÚÆ) { IO::remove($€ÛÒ¥…Ä); } return $ÔëéÈÚÆ ? $­¼Šèë• : !1; } public function tempFile($àßô©°˜ = '', $ï³ªô—¯ = '') { if (!$àßô©°˜) { $àßô©°˜ = rand_string(15); } $¸¡ÂğËÔ = TEMP_FILES . rand_string(15) . $_SERVER[ÆªÈ–¬][8]; @mkdir($¸¡ÂğËÔ, DEFAULT_PERRMISSIONS, !0); $û®Ô¼š = $¸¡ÂğËÔ . $àßô©°˜; @touch($û®Ô¼š); if ($ï³ªô—¯) { file_put_contents($û®Ô¼š, $ï³ªô—¯); } return $û®Ô¼š; } public function tempFileRemve($¸Õşïèç) { @unlink($¸Õşïèç); @rmdir($this->pathFather($¸Õşïèç)); } public function mkfile($ˆÉö¾¥ë, $Ï­úä = '', $Ì‹ÃÒÑ¼ = REPEAT_RENAME) { } public function mkdir($©È½³¿ö, $×Ûã­‡ = REPEAT_SKIP) { } public function delFile($ÇÑ½ğè­) { } public function delFolder($¢³•™³¼) { } public function copyFile($¡ë™´îç, $úÎüÛ) { } public function moveFile($¥¡ò»Ûµ, $ê÷ÚÌŒò) { } public function remove($åËãÚô) { if ($this->isFile($åËãÚô)) { return $this->delFile($åËãÚô); } return $this->delFolder($åËãÚô); } public function rename($İ¸‡º„µ, $ÆÆÚ†Û¼) { } public function exist($ŞˆÃ„ãÁ) { } public function findByHash($ÄÉóØÑ­ = '', $Ã™÷ğÀà = '') { return !1; } public function isFile($ìäÃ½¿²) { } public function isFolder($³†Æóù¾) { } public function size($¹ËŞáè¤) { } public function info($Êé©õ©Ò) { } public function infoSimple($„ãÜÊäÄ) { return $this->info($„ãÜÊäÄ); } public function infoAuth($†­òÆ“ø) { return $this->info($†­òÆ“ø); } public function infoFull($Ó£¶ñÃ) { return $this->info($Ó£¶ñÃ); } public function infoFullSimple($ƒÊ¶¤¥ò) { return $this->info($ƒÊ¶¤¥ò); } public function infoWithChildren($µ°”À‘») { $ö†ò˜€ =& $_SERVER[ÆªÈ–¬]; static $“ŞÏÄà = array(); if (isset($“ŞÏÄà[$µ°”À‘»])) { return $“ŞÏÄà[$µ°”À‘»]; } $¢ıÓÚ®® = $this->info($µ°”À‘»); if ($¢ıÓÚ®® && $¢ıÓÚ®®[$ö†ò˜€[33]] == $ö†ò˜€[78]) { $ŞÜê»Å· = array($ö†ò˜€[79] => 0, $ö†ò˜€[80] => 0, $ö†ò˜€[81] => 0); $this->infoChildren($µ°”À‘», $ŞÜê»Å·); $¢ıÓÚ®®[$ö†ò˜€[79]] = $ŞÜê»Å·[$ö†ò˜€[79]]; $¢ıÓÚ®®[$ö†ò˜€[82]] = array($ö†ò˜€[83] => $ŞÜê»Å·[$ö†ò˜€[80]], $ö†ò˜€[84] => $ŞÜê»Å·[$ö†ò˜€[81]]); $“ŞÏÄà[$µ°”À‘»] = $¢ıÓÚ®®; } return $¢ıÓÚ®®; } public function listPath($¶Â©©Ï, $õœÌú÷ã = false) { } public function has($ÒÍÒè—, $š•–ôú» = false, $àÛ°€ğÔ = false) { } public function canRead($®½¦ñ€õ) { } public function canWrite($òî“Óƒ½) { } public function getContent($ó¡äèÎ) { } public function setContent($Î‘öÃš, $ğÄ‰ÊÃÌ = '') { } protected function infoChildren($ØåØ´ûÜ, &$†¡¼¿ö) { $ÙÔáô÷ª =& $_SERVER[ÆªÈ–¬]; check_abort_echo(); $¡ÄªÆ˜ = $this->listPath($ØåØ´ûÜ, !0); $¡ÄªÆ˜ = array_merge($¡ÄªÆ˜[$ÙÔáô÷ª[85]], $¡ÄªÆ˜[$ÙÔáô÷ª[86]]); foreach ($¡ÄªÆ˜ as $³°“ü„) { if ($³°“ü„[$ÙÔáô÷ª[33]] == $ÙÔáô÷ª[78]) { $†¡¼¿ö[$ÙÔáô÷ª[81]]++; $‘ÀØĞË¡ = $this->getPathInner($³°“ü„[$ÙÔáô÷ª[87]]); $this->infoChildren($‘ÀØĞË¡, $†¡¼¿ö); } else { $†¡¼¿ö[$ÙÔáô÷ª[80]]++; $†¡¼¿ö[$ÙÔáô÷ª[79]] += $³°“ü„[$ÙÔáô÷ª[79]]; } } } public function fileSubstr($’Šù‰Õµ, $¢êáˆ®’, $şÔÃŒ·Á) { } public function listAll($÷Ôšº¦Õ) { } public function listAllMake($‚™Óë™ƒ, &$ÇÜµ¶À¬) { $çıÃÇğí =& $_SERVER[ÆªÈ–¬]; check_abort_echo(); $çûû†èŠ = $this->listPath($‚™Óë™ƒ, !0); if (!$çûû†èŠ) { return; } $¯í¬Ò‹ = array_merge($çûû†èŠ[$çıÃÇğí[85]], $çûû†èŠ[$çıÃÇğí[86]]); foreach ($¯í¬Ò‹ as $Îâ´¬…À) { $€˜–óÇ = $Îâ´¬…À[$çıÃÇğí[33]] == $çıÃÇğí[78]; $´¡Şˆ‚ = array($çıÃÇğí[87] => $Îâ´¬…À[$çıÃÇğí[87]], $çıÃÇğí[78] => $€˜–óÇ); if (isset($Îâ´¬…À[$çıÃÇğí[79]])) { $´¡Şˆ‚[$çıÃÇğí[79]] = $Îâ´¬…À[$çıÃÇğí[79]]; } if (isset($Îâ´¬…À[$çıÃÇğí[88]])) { $´¡Şˆ‚[$çıÃÇğí[88]] = $Îâ´¬…À[$çıÃÇğí[88]]; } if (!$€˜–óÇ) { $ÇÜµ¶À¬[] = $´¡Şˆ‚; continue; } $ÇÜµ¶À¬[] = $´¡Şˆ‚; $®ä˜ûŞ” = $Îâ´¬…À[$çıÃÇğí[87]]; $º°ƒÎ¾¼ = $this->pathDriver; if (substr($Îâ´¬…À[$çıÃÇğí[87]], 0, strlen($º°ƒÎ¾¼)) == $º°ƒÎ¾¼) { $®ä˜ûŞ” = substr($®ä˜ûŞ”, strlen($º°ƒÎ¾¼)); } $this->listAllMake($®ä˜ûŞ”, $ÇÜµ¶À¬); } } public function listAllSimple($åŒ¯¯­¤, $­ÁˆßÇ = false) { $µÆÈ­ = $this->listAll($åŒ¯¯­¤); return $this->listAllSimpleMake($µÆÈ­, $this->getPathOuter($åŒ¯¯­¤), $­ÁˆßÇ); } public function listAllSimpleMake($ÕŒìÕ†, $İÉÌŒÊû, $–§Ç©š) { $‘ˆ ºö =& $_SERVER[ÆªÈ–¬]; $Ë¸Ò¹­à = array(); $İÉÌŒÊû = rtrim(get_path_father($İÉÌŒÊû), $‘ˆ ºö[8]) . $‘ˆ ºö[8]; foreach ($ÕŒìÕ† as $¤¢ñäÏÌ) { $‚–Ğºå” = array($‘ˆ ºö[87] => $¤¢ñäÏÌ[$‘ˆ ºö[87]], $‘ˆ ºö[89] => $¤¢ñäÏÌ[$‘ˆ ºö[87]], $‘ˆ ºö[78] => $¤¢ñäÏÌ[$‘ˆ ºö[78]]); if (isset($¤¢ñäÏÌ[$‘ˆ ºö[79]]) && !$¤¢ñäÏÌ[$‘ˆ ºö[78]]) { $‚–Ğºå”[$‘ˆ ºö[79]] = $¤¢ñäÏÌ[$‘ˆ ºö[79]]; } if (isset($¤¢ñäÏÌ[$‘ˆ ºö[88]])) { $‚–Ğºå”[$‘ˆ ºö[88]] = $¤¢ñäÏÌ[$‘ˆ ºö[88]]; } if (is_array($¤¢ñäÏÌ[$‘ˆ ºö[90]])) { $‚–Ğºå”[$‘ˆ ºö[89]] = $¤¢ñäÏÌ[$‘ˆ ºö[90]][$‘ˆ ºö[87]]; $‚–Ğºå”[$‘ˆ ºö[79]] = $¤¢ñäÏÌ[$‘ˆ ºö[90]][$‘ˆ ºö[79]]; $‚–Ğºå”[$‘ˆ ºö[88]] = $¤¢ñäÏÌ[$‘ˆ ºö[90]][$‘ˆ ºö[88]]; } else { if (substr($¤¢ñäÏÌ[$‘ˆ ºö[87]], 0, strlen($İÉÌŒÊû)) == $İÉÌŒÊû) { $‚–Ğºå”[$‘ˆ ºö[87]] = substr($¤¢ñäÏÌ[$‘ˆ ºö[87]], strlen($İÉÌŒÊû)); } } $ŠêÙúÙˆ = $¤¢ñäÏÌ[$‘ˆ ºö[78]] ? $‘ˆ ºö[8] : $‘ˆ ºö[12]; $‚–Ğºå”[$‘ˆ ºö[89]] = rtrim($‚–Ğºå”[$‘ˆ ºö[89]], $‘ˆ ºö[8]) . $ŠêÙúÙˆ; $‚–Ğºå”[$‘ˆ ºö[87]] = $‘ˆ ºö[8] . trim($‚–Ğºå”[$‘ˆ ºö[87]], $‘ˆ ºö[8]) . $ŠêÙúÙˆ; if (!$–§Ç©š) { $ÅûéŠ• = explode($‘ˆ ºö[8], trim($‚–Ğºå”[$‘ˆ ºö[87]], $‘ˆ ºö[8])); $‚–Ğºå”[$‘ˆ ºö[87]] = $‘ˆ ºö[8] . implode($‘ˆ ºö[8], array_slice($ÅûéŠ•, 1)) . $ŠêÙúÙˆ; } $Ë¸Ò¹­à[] = $‚–Ğºå”; } return array_sort_by($Ë¸Ò¹­à, $‘ˆ ºö[87]); } public function upload($×ş¹óú, $”í«Ğ¬ñ, $Àòü¹Ëş = false, $Ğ†ı©Ëü = REPEAT_REPLACE) { } public function uploadFileByID($é§Ó¦“¥, $›ì­¥‡µ, $—é·Î“Î) { } public function uploadFileByPath($œŒŠ”„, $÷¨©î¿ı, $›¥—÷¿¿ = array()) { } public function isUploadServer() { $Ô„”‰ıª =& $_SERVER[ÆªÈ–¬]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ô„”‰ıª[91]) { return !0; } return $GLOBALS[$Ô„”‰ıª[6]][$Ô„”‰ıª[92]][$Ô„”‰ıª[93]]; } public function isFileOutServer() { $ï„ùÜÒ… =& $_SERVER[ÆªÈ–¬]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ï„ùÜÒ…[91]) { return !0; } return $GLOBALS[$ï„ùÜÒ…[6]][$ï„ùÜÒ…[92]][$ï„ùÜÒ…[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¹°ÚìÙ) { $à‚ƒ´Ñè =& $_SERVER[ÆªÈ–¬]; if (!$this->isCdnHost()) { return $¹°ÚìÙ; } return str_replace(trim(get_url_root($¹°ÚìÙ), $à‚ƒ´Ñè[8]), trim($this->cdnHost, $à‚ƒ´Ñè[8]), $¹°ÚìÙ); } public function uploadLink($‚›¨º›ª, $Ëé»äáÊ = 0) { $„•ó…‘ =& $_SERVER[ÆªÈ–¬]; if ($this->isUploadServer()) { return; } $„ñ×Ñîõ = $this->getType(); if (!in_array($„ñ×Ñîõ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $÷¶ËŞÚŞ = 1024 * 1024 * 10; $üŞ’ˆôÙ = $Ëé»äáÊ <= $÷¶ËŞÚŞ ? $„•ó…‘[95] : $„•ó…‘[96]; $ÇÉº®Ãò = (!$Ëé»äáÊ ? 1 : ceil($Ëé»äáÊ / pow(1024, 3))) * 3600 * 4; $ÂÏİö÷” = $this->{$üŞ’ˆôÙ}($‚›¨º›ª, $ÇÉº®Ãò); if ($ÂÏİö÷”) { $ÂÏİö÷”[$„•ó…‘[97]] = $‚›¨º›ª; $ÂÏİö÷”[$„•ó…‘[98]] = $„ñ×Ñîõ; } return $ÂÏİö÷”; } public function uploadFormData($Î¸áº¢Ã, $Òş£°‰ = 3600) { } public function multiUploadFormData($İâ¥•Ú, $ïàû°Ö = 3600) { } public function download($¶–ŸŸÈ×, $é°ˆ«Ôí) { } public function ext($‚ŒÊêÑÂ) { $ïåï©â• =& $_SERVER[ÆªÈ–¬]; if (strpos($‚ŒÊêÑÂ, $ïåï©â•[8]) === -1) { $ï Šõ° = $‚ŒÊêÑÂ; } else { $ï Šõ° = $this->pathThis($‚ŒÊêÑÂ); } $ ÛŠ­ºß = $ïåï©â•[12]; if (strstr($ï Šõ°, $ïåï©â•[10])) { $ ÛŠ­ºß = substr($ï Šõ°, strrpos($ï Šõ°, $ïåï©â•[10]) + 1); $ ÛŠ­ºß = strtolower($ ÛŠ­ºß); } if (strlen($ ÛŠ­ºß) > 3 && preg_match($ïåï©â•[99], $ ÛŠ­ºß, $›õ¤óò¼)) { $ ÛŠ­ºß = $ïåï©â•[12]; } return $ ÛŠ­ºß; } public function pathThis($µ…è­˜Ş) { $·„šë› =& $_SERVER[ÆªÈ–¬]; $µ…è­˜Ş = str_replace($·„šë›[100], $·„šë›[8], rtrim($µ…è­˜Ş, $·„šë›[8])); $í´‚´‹“ = strrpos($µ…è­˜Ş, $·„šë›[8]); if ($í´‚´‹“ === !1) { return $µ…è­˜Ş; } return substr($µ…è­˜Ş, $í´‚´‹“ + 1); } public function pathFather($éŒ”Ñ¬Æ) { $“ùÃ˜ö =& $_SERVER[ÆªÈ–¬]; $éŒ”Ñ¬Æ = str_replace($“ùÃ˜ö[100], $“ùÃ˜ö[8], rtrim($éŒ”Ñ¬Æ, $“ùÃ˜ö[8])); $ïüÉà = strrpos($éŒ”Ñ¬Æ, $“ùÃ˜ö[8]); if ($ïüÉà === !1) { return $“ùÃ˜ö[12]; } return substr($éŒ”Ñ¬Æ, 0, $ïüÉà + 1); } public function hashSimple($üİØæ·‹) { $®Âı¿º =& $_SERVER[ÆªÈ–¬]; if (!$üİØæ·‹) { return md5($®Âı¿º[12]); } $Ç‚´·ÈŒ = $this->size($üİØæ·‹); $·ÆíÕù = 200; $Ó®í¤ßã = 50; if ($Ç‚´·ÈŒ <= $·ÆíÕù * $Ó®í¤ßã) { return $this->hashMd5($üİØæ·‹) . $Ç‚´·ÈŒ; } $À÷İáƒş = intval($Ç‚´·ÈŒ / $Ó®í¤ßã); $²€”ø’ë = $®Âı¿º[12]; for ($¤ÀÚÌŞÑ = 0; $¤ÀÚÌŞÑ < $Ó®í¤ßã; $¤ÀÚÌŞÑ++) { $²€”ø’ë .= $this->fileSubstr($üİØæ·‹, $À÷İáƒş * $¤ÀÚÌŞÑ, $·ÆíÕù); } $²€”ø’ë .= $this->fileSubstr($üİØæ·‹, $Ç‚´·ÈŒ - $·ÆíÕù, $·ÆíÕù); return md5($²€”ø’ë) . $Ç‚´·ÈŒ; } public static $md5Cache = array(); public function hashMd5($ÛîÃ…÷ı) { if (!$ÛîÃ…÷ı) { return md5($_SERVER[ÆªÈ–¬][12]); } $ÛîÃ…÷ı = $this->iconvSystem($ÛîÃ…÷ı); if (isset(self::$md5Cache[$ÛîÃ…÷ı])) { return self::$md5Cache[$ÛîÃ…÷ı]; } self::$md5Cache[$ÛîÃ…÷ı] = $this->hashMd5Shell($ÛîÃ…÷ı); if (!self::$md5Cache[$ÛîÃ…÷ı]) { self::$md5Cache[$ÛîÃ…÷ı] = @md5_file($ÛîÃ…÷ı); } return self::$md5Cache[$ÛîÃ…÷ı]; } private function hashMd5Shell($Ë‘úŒ°Ñ) { $…Àğ—¶ğ =& $_SERVER[ÆªÈ–¬]; if (!$Ë‘úŒ°Ñ) { return md5($…Àğ—¶ğ[12]); } if (!function_exists($…Àğ—¶ğ[101])) { return !1; } $ıëÎ”–ğ = array($…Àğ—¶ğ[102], $…Àğ—¶ğ[103]); $•ñÂ÷¦ = Cache::get($…Àğ—¶ğ[104]); if (!$•ñÂ÷¦) { $ıåØ…©» = BASIC_PATH . $…Àğ—¶ğ[105]; $²éËÒ = md5_file($ıåØ…©»); $•ñÂ÷¦ = $…Àğ—¶ğ[106]; foreach ($ıëÎ”–ğ as $äÓç—ø) { $µ¡Ö®†‰ = shell_exec($äÓç—ø . "\40\42{$ıåØ…©»}\x22"); if ($µ¡Ö®†‰ && substr(trim($µ¡Ö®†‰), 0, 32) == $²éËÒ) { $•ñÂ÷¦ = $äÓç—ø; break; } } Cache::set($…Àğ—¶ğ[104], $•ñÂ÷¦, 3600); } if ($•ñÂ÷¦ == $…Àğ—¶ğ[106]) { return !1; } $µ¡Ö®†‰ = shell_exec($•ñÂ÷¦ . "\40\x22{$Ë‘úŒ°Ñ}\x22"); $µ¡Ö®†‰ = str_replace($…Àğ—¶ğ[107], $…Àğ—¶ğ[12], $µ¡Ö®†‰); return substr($µ¡Ö®†‰, 0, 32); } public function link($ÑéÔœÅ‚) { return $ÑéÔœÅ‚; } public function fileOut($³ŠÃËïæ, $ëíïÂ¤Í = false, $–È®òá“ = false, $åÂÇ™¸³ = '') { $ÎÖ½áŞ© =& $_SERVER[ÆªÈ–¬]; $this->cacheMethod(null, null); if (!$³ŠÃËïæ || !$this->exist($³ŠÃËïæ)) { show_json(LNG($ÎÖ½áŞ©[108]), !1, $–È®òá“); } $¢ÜŸÛ¤ö = $this->getType() == $ÎÖ½áŞ©[109]; $ù´ßéæë = $GLOBALS[$ÎÖ½áŞ©[6]][$ÎÖ½áŞ©[92]][$ÎÖ½áŞ©[110]][$ÎÖ½áŞ©[111]]; $¿èê÷³„ = (double) $GLOBALS[$ÎÖ½áŞ©[6]][$ÎÖ½áŞ©[92]][$ÎÖ½áŞ©[110]][$ÎÖ½áŞ©[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $“Ñœ¾÷ = $this->infoFull($³ŠÃËïæ); $ªù­ºãœ = $“Ñœ¾÷[$ÎÖ½áŞ©[79]]; $ó¬¶³ ‰ = gmdate($ÎÖ½áŞ©[113], $“Ñœ¾÷[$ÎÖ½áŞ©[88]]); $Ğ´­òÉ = $–È®òá“ ? $–È®òá“ : $this->iconvApp($“Ñœ¾÷[$ÎÖ½áŞ©[32]]); $½Å­ş×ò = 0; $€Ãğêš‚ = $ªù­ºãœ - 1; $Ğ’ŠÌ”ê = $this->ext($Ğ´­òÉ); if (in_array($Ğ’ŠÌ”ê, array($ÎÖ½áŞ©[114], $ÎÖ½áŞ©[115], $ÎÖ½áŞ©[116], $ÎÖ½áŞ©[117]))) { $Ğ’ŠÌ”ê = $ÎÖ½áŞ©[118]; } if (in_array($Ğ’ŠÌ”ê, array($ÎÖ½áŞ©[119]))) { $Ğ’ŠÌ”ê = $ÎÖ½áŞ©[120]; } if (!$åÂÇ™¸³) { $åÂÇ™¸³ = md5($ó¬¶³ ‰ . $ªù­ºãœ); } $åÂÇ™¸³ = $ÎÖ½áŞ©[121] . $åÂÇ™¸³ . $ÎÖ½áŞ©[121]; $È‹óõ¤ë = get_file_mime($Ğ’ŠÌ”ê); $ƒ‰æ¢¸ò = !0; $ƒ‰æ¢¸ò = isset($_GET[$ÎÖ½áŞ©[122]]) ? !1 : !0; if ($ëíïÂ¤Í === !1 && !mime_support($È‹óõ¤ë)) { $È‹óõ¤ë = $ÎÖ½áŞ©[123]; } header($ÎÖ½áŞ©[124]); header($ÎÖ½áŞ©[125] . $È‹óõ¤ë); $ãßïİºÍ = rawurlencode($Ğ´­òÉ); $ãßïİºÍ = $ÎÖ½áŞ©[121] . $ãßïİºÍ . $ÎÖ½áŞ©[126] . $ãßïİºÍ; if ($ëíïÂ¤Í) { header($ÎÖ½áŞ©[127]); header($ÎÖ½áŞ©[128] . $ãßïİºÍ); } else { if ($ƒ‰æ¢¸ò) { header($ÎÖ½áŞ©[129] . $ãßïİºÍ); } } $Äùòæë¶ = 3600 * 24 * 30; header($ÎÖ½áŞ©[130]); header($ÎÖ½áŞ©[131]); header($ÎÖ½áŞ©[132] . $Äùòæë¶); header($ÎÖ½áŞ©[133] . gmdate($ÎÖ½áŞ©[113], time() + $Äùòæë¶) . $ÎÖ½áŞ©[134]); if (isset($_SERVER[$ÎÖ½áŞ©[135]]) && strtotime($_SERVER[$ÎÖ½áŞ©[135]]) == $“Ñœ¾÷[$ÎÖ½áŞ©[88]]) { header($ÎÖ½áŞ©[136], !0, 304); die; } if (isset($_SERVER[$ÎÖ½áŞ©[137]]) && $_SERVER[$ÎÖ½áŞ©[137]] == $åÂÇ™¸³) { header($ÎÖ½áŞ©[138] . $åÂÇ™¸³, !0, 304); die; } header($ÎÖ½áŞ©[138] . $åÂÇ™¸³); header($ÎÖ½áŞ©[139] . $ó¬¶³ ‰ . $ÎÖ½áŞ©[134]); header($ÎÖ½áŞ©[140] . $Ğ´­òÉ); header($ÎÖ½áŞ©[141]); header($ÎÖ½áŞ©[142] . $ªù­ºãœ); header($ÎÖ½áŞ©[143]); Hook::trigger($ÎÖ½áŞ©[144], $³ŠÃËïæ, $ªù­ºãœ, $Ğ´­òÉ, $Ğ’ŠÌ”ê); if (!$ëíïÂ¤Í && $Ğ’ŠÌ”ê == $ÎÖ½áŞ©[145]) { if ($ªù­ºãœ > 1024 * 1024 * 5) { die; } $Õ–¬£³ = $this->getContent($³ŠÃËïæ); $Õ–¬£³ = Html::clearSVG($Õ–¬£³); header($ÎÖ½áŞ©[146] . strlen($Õ–¬£³)); echo $Õ–¬£³; die; } $ïÍÖÅí§ = strtolower($_SERVER[$ÎÖ½áŞ©[147]]); if ($¢ÜŸÛ¤ö && $ïÍÖÅí§ && $ù´ßéæë) { if (strstr($ïÍÖÅí§, $ÎÖ½áŞ©[148])) { header($ÎÖ½áŞ©[149] . $³ŠÃËïæ); } else { if (strstr($ïÍÖÅí§, $ÎÖ½áŞ©[150])) { header($ÎÖ½áŞ©[151] . $³ŠÃËïæ); } else { if (strstr($ïÍÖÅí§, $ÎÖ½áŞ©[152])) { header($ÎÖ½áŞ©[153] . $³ŠÃËïæ); } } } if ($¿èê÷³„) { header($ÎÖ½áŞ©[154] . $¿èê÷³„); } return; } if (isset($_SERVER[$ÎÖ½áŞ©[155]])) { if (preg_match($ÎÖ½áŞ©[156], $_SERVER[$ÎÖ½áŞ©[155]], $êšË¡Àë)) { $½Å­ş×ò = intval($êšË¡Àë[1]); $½Å­ş×ò = $½Å­ş×ò <= 0 ? 0 : ($½Å­ş×ò >= $€Ãğêš‚ ? $€Ãğêš‚ : $½Å­ş×ò); if (!empty($êšË¡Àë[2])) { $°…™Ö“– = intval($êšË¡Àë[2]); $€Ãğêš‚ = $°…™Ö“– < $½Å­ş×ò ? $½Å­ş×ò : ($°…™Ö“– >= $€Ãğêš‚ ? $€Ãğêš‚ : $°…™Ö“–); } } header($ÎÖ½áŞ©[157]); header("\x43\x6f\156\x74\x65\x6e\164\x2d\122\141\156\147\145\72\x20\x62\x79\164\x65\x73\x20{$½Å­ş×ò}\x2d{$€Ãğêš‚}\x2f" . $ªù­ºãœ); } else { header($ÎÖ½áŞ©[158]); } header($ÎÖ½áŞ©[159]); header($ÎÖ½áŞ©[160]); $Ôîˆş = !0; if ($_SERVER[$ÎÖ½áŞ©[161]] == $ÎÖ½áŞ©[162] && $ªù­ºãœ > 1204 * 1024 * 1024 * 2) { $Ôîˆş = !1; } if ($Ôîˆş) { header($ÎÖ½áŞ©[163] . ($€Ãğêš‚ - $½Å­ş×ò + 1)); } if ($_SERVER[$ÎÖ½áŞ©[164]] == $ÎÖ½áŞ©[165]) { return; } $İ‚ûöìÓ = array($ÎÖ½áŞ©[166] => !1, $ÎÖ½áŞ©[167] => $½Å­ş×ò, $ÎÖ½áŞ©[168] => $€Ãğêš‚, $ÎÖ½áŞ©[169] => $Ğ’ŠÌ”ê, $ÎÖ½áŞ©[170] => $“Ñœ¾÷, $ÎÖ½áŞ©[171] => $ÎÖ½áŞ©[12], $ÎÖ½áŞ©[172] => 0); $İ‚ûöìÓ = Hook::filter($ÎÖ½áŞ©[173], $İ‚ûöìÓ); $¯©ø€ùû = 1024 * 300; $¡š°•ôò = 0; if ($¿èê÷³„) { $¡š°•ôò = intval(1000 * 1000 * ($¯©ø€ùû / $¿èê÷³„)); } while ($½Å­ş×ò <= $€Ãğêš‚) { $‘‰¡‡Ê› = timeFloat(); check_abort(); $§”ËÛğß = $€Ãğêš‚ - $½Å­ş×ò + 1; if ($§”ËÛğß <= $¯©ø€ùû) { $¯©ø€ùû = $§”ËÛğß; } $Õ–¬£³ = $this->fileSubstr($³ŠÃËïæ, $½Å­ş×ò, $¯©ø€ùû); if ($İ‚ûöìÓ[$ÎÖ½áŞ©[166]]) { $İ‚ûöìÓ[$ÎÖ½áŞ©[171]] = $Õ–¬£³; $İ‚ûöìÓ[$ÎÖ½áŞ©[172]] = $½Å­ş×ò; $İ‚ûöìÓ = Hook::filter($ÎÖ½áŞ©[174], $İ‚ûöìÓ); $Õ–¬£³ = $İ‚ûöìÓ[$ÎÖ½áŞ©[171]]; } echo $Õ–¬£³; $½Å­ş×ò += $¯©ø€ùû; if ($¯©ø€ùû == $§”ËÛğß) { $½Å­ş×ò = $€Ãğêš‚ + 1; } if ($¡š°•ôò) { $Àñ«ƒì¢ = intval(1000 * 1000 * (timeFloat() - $‘‰¡‡Ê›)); $åı˜ÂªÒ = $¡š°•ôò - $Àñ«ƒì¢; if ($åı˜ÂªÒ > 5) { usleep($åı˜ÂªÒ); } } } } public function fileOutServer($¨³Å¼ä, $üÙŸàá† = false, $ˆ”ßôÃ— = false, $±§·±Š = '') { $this->fileOut($¨³Å¼ä, $üÙŸàá†, $ˆ”ßôÃ—, $±§·±Š); } public function fileOutLink($‰Êì×Äé) { header($_SERVER[ÆªÈ–¬][175] . $‰Êì×Äé); die; } public function cacheMethod($ÑÓùİ, $®¶Š½ò¿, $Šºş™Õ“ = null) { $êˆ£¨Áğ =& $_SERVER[ÆªÈ–¬]; static $Û åü¹· = array(); $´ Çòì = $®¶Š½ò¿ ? ltrim($this->getPathOuter($®¶Š½ò¿), $êˆ£¨Áğ[8]) : $êˆ£¨Áğ[12]; $ÁôõøÚ° = $êˆ£¨Áğ[176] . $ÑÓùİ . $êˆ£¨Áğ[177] . rtrim($´ Çòì, $êˆ£¨Áğ[8]); if (is_null($ÑÓùİ)) { $Û åü¹· = array(); return; } if (is_null($®¶Š½ò¿)) { foreach ($Û åü¹· as $ÁôõøÚ° => $şàñêÆÂ) { if (!strstr($ÁôõøÚ°, $êˆ£¨Áğ[176] . $ÑÓùİ . $êˆ£¨Áğ[178])) { continue; } unset($Û åü¹·[$ÁôõøÚ°]); } return; } if (!is_null($Šºş™Õ“)) { $Û åü¹·[$ÁôõøÚ°] = $Šºş™Õ“; return; } $õô®ğÛ« = isset($Û åü¹·[$ÁôõøÚ°]) ? $Û åü¹·[$ÁôõøÚ°] : null; if (!is_null($õô®ğÛ«)) { return $õô®ğÛ«; } $õô®ğÛ« = $this->{$ÑÓùİ}($®¶Š½ò¿); $Û åü¹·[$ÁôõøÚ°] = $õô®ğÛ«; return $õô®ğÛ«; } public function cacheMethodInfoSet($–×Á·, $ööô©¼Ú, $Í…Ö®æÜ = false) { $‚îúÀÂ± =& $_SERVER[ÆªÈ–¬]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‚îúÀÂ±[179], $–×Á·, $ööô©¼Ú); $this->cacheMethod($‚îúÀÂ±[180], $–×Á·, $ööô©¼Ú ? !1 : !0); if (is_array($Í…Ö®æÜ)) { $this->cacheMethod($‚îúÀÂ±[181], $–×Á·, $Í…Ö®æÜ); } } public function fileOutImage($ÒîÁ¿Öá, $£¸ç¯è = 250) { $Ôªó¸Ü® =& $_SERVER[ÆªÈ–¬]; set_timeout(); if (substr($ÒîÁ¿Öá, 0, 4) == $Ôªó¸Ü®[152]) { $this->fileOutLink($ÒîÁ¿Öá); } $ÎÜĞ«áî = $this->info($ÒîÁ¿Öá); $Æ·üİ£ = !1; $Š½ßéÕ™ = isset($GLOBALS[$Ôªó¸Ü®[182]]) ? $GLOBALS[$Ôªó¸Ü®[182]] : array(); if ($Š½ßéÕ™ && $Š½ßéÕ™[$Ôªó¸Ü®[183]] == $ÎÜĞ«áî[$Ôªó¸Ü®[87]]) { $ÎÜĞ«áî = $Š½ßéÕ™; $¿ˆòªıå = $ÎÜĞ«áî[$Ôªó¸Ü®[184]]; if ($¿ˆòªıå && isset($¿ˆòªıå[$Ôªó¸Ü®[185]])) { if ($¿ˆòªıå[$Ôªó¸Ü®[185]] <= $£¸ç¯è && $¿ˆòªıå[$Ôªó¸Ü®[186]] <= $£¸ç¯è) { $Æ·üİ£ = !0; } } } if ($ÎÜĞ«áî[$Ôªó¸Ü®[79]] <= 1024 * 50 || $Æ·üİ£ || !function_exists($Ôªó¸Ü®[187]) || $ÎÜĞ«áî[$Ôªó¸Ü®[169]] == $Ôªó¸Ü®[188]) { return $this->fileOut($ÒîÁ¿Öá, !1, $ÎÜĞ«áî[$Ôªó¸Ü®[32]]); } $ı†º˜¦¦ = kodIO::hashPath($ÎÜĞ«áî); $ãÍæ±¨Á = "\143\x6f\166\145\x72\137{$ı†º˜¦¦}\x5f{$£¸ç¯è}\56\160\156\x67"; $Ş‚ï‡ØÀ = IO_PATH_SYSTEM_TEMP . $Ôªó¸Ü®[189]; $èÑğªÉ = IO::infoFullSimple($Ş‚ï‡ØÀ); $ˆÃê¹­­ = $èÑğªÉ && is_array($èÑğªÉ) ? $èÑğªÉ[$Ôªó¸Ü®[87]] : $Ôªó¸Ü®[12]; if (!$ˆÃê¹­­) { $ˆÃê¹­­ = IO::mkdir($Ş‚ï‡ØÀ); } if ($ÎÜĞ«áî[$Ôªó¸Ü®[190]] == $Ôªó¸Ü®[191] && isset($ÎÜĞ«áî[$Ôªó¸Ü®[192]]) && $ÎÜĞ«áî[$Ôªó¸Ü®[192]] == kodIO::sourceID($ˆÃê¹­­)) { $§‰ì¥¢´ = $ÎÜĞ«áî[$Ôªó¸Ü®[193]]; if ($£¸ç¯è <= 500) { $îó…ºª„ = preg_replace($Ôªó¸Ü®[194], $Ôªó¸Ü®[195], $ÎÜĞ«áî[$Ôªó¸Ü®[32]]); $§‰ì¥¢´ = IO::fileNameExist($ˆÃê¹­­, $îó…ºª„); } return IO::fileOut(KodIO::make($§‰ì¥¢´), !1, $ÎÜĞ«áî[$Ôªó¸Ü®[32]]); } $¦³¸Ùá² = IO::fileNameExist($ˆÃê¹­­, $ãÍæ±¨Á); if ($¦³¸Ùá²) { return IO::fileOut(KodIO::make($¦³¸Ùá²), !1, $ÎÜĞ«áî[$Ôªó¸Ü®[32]]); } if ($£¸ç¯è > 1000) { $this->makeImageCover($ˆÃê¹­­, $ÒîÁ¿Öá, $ãÍæ±¨Á, $£¸ç¯è); $this->makeImageCover($ˆÃê¹­­, $ÒîÁ¿Öá, "\143\157\x76\145\x72\137{$ı†º˜¦¦}\x5f\62\65\60\56\x70\156\147", 250); $¦³¸Ùá² = IO::fileNameExist($ˆÃê¹­­, $ãÍæ±¨Á); if ($¦³¸Ùá²) { return IO::fileOut(KodIO::make($¦³¸Ùá²), !1, $ÎÜĞ«áî[$Ôªó¸Ü®[32]]); } die; } $‰·ı»ã = Cache::get($ãÍæ±¨Á); if ($‰·ı»ã == $Ôªó¸Ü®[196] || $‰·ı»ã == $Ôªó¸Ü®[197]) { echo $‰·ı»ã; die; } Cache::set($ãÍæ±¨Á, $Ôªó¸Ü®[197], 60); $Ïû­õÙİ = array($ˆÃê¹­­, $ÎÜĞ«áî[$Ôªó¸Ü®[87]], $ãÍæ±¨Á, $£¸ç¯è); $²Ìé¬ßŸ = $Ôªó¸Ü®[198] . $ÎÜĞ«áî[$Ôªó¸Ü®[79]] . $Ôªó¸Ü®[199] . $ãÍæ±¨Á . $Ôªó¸Ü®[200] . $ÎÜĞ«áî[$Ôªó¸Ü®[32]] . $Ôªó¸Ü®[201] . $ÎÜĞ«áî[$Ôªó¸Ü®[87]]; TaskQueue::add($Ôªó¸Ü®[202], $Ïû­õÙİ, $²Ìé¬ßŸ, $ãÍæ±¨Á); } public function makeImageCover($æû’Á¡•, $½´˜„ğê, $Ùúıö÷¡, $åòãÉ ±) { $õÁüçü =& $_SERVER[ÆªÈ–¬]; if (IO::fileNameExist($æû’Á¡•, $Ùúıö÷¡)) { return $õÁüçü[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $áø—¹Óè = DATA_THUMB . $Ùúıö÷¡; del_file($áø—¹Óè); $¦Ç´‰¸Æ = IO::copy($½´˜„ğê, TEMP_FILES, !1, $Ùúıö÷¡); if (!@file_exists($¦Ç´‰¸Æ)) { return $õÁüçü[204]; } ImageThumb::createThumb($¦Ç´‰¸Æ, $áø—¹Óè, $åòãÉ ±, $åòãÉ ± * 10); if (@file_exists($áø—¹Óè)) { Cache::remove($Ùúıö÷¡); return IO::move($áø—¹Óè, $æû’Á¡•); } Cache::set($Ùúıö÷¡, $õÁüçü[196], 600); del_file($áø—¹Óè); return $õÁüçü[205] . $¦Ç´‰¸Æ . $õÁüçü[74]; } public function fileOutImageServer($„½ª™²Œ, $÷û¨ŞÕÇ = 250) { $this->fileOutImage($„½ª™²Œ, $÷û¨ŞÕÇ); } public function fileNameAuto($“¢•ãù½, $Ş€Œ…ë›, $‚ş³ËŠç = REPEAT_RENAME, $¡Ù¡¯Æ– = false) { $ì ‡•«« =& $_SERVER[ÆªÈ–¬]; $ä¤ô†ğ = $“¢•ãù½ === $ì ‡•««[12] ? $Ş€Œ…ë› : rtrim($“¢•ãù½, $ì ‡•««[8]) . $ì ‡•««[8] . $Ş€Œ…ë›; if ($‚ş³ËŠç == REPEAT_REPLACE || !$this->exist($ä¤ô†ğ) || $¡Ù¡¯Æ– && $‚ş³ËŠç != REPEAT_RENAME_FOLDER) { return $Ş€Œ…ë›; } if ($‚ş³ËŠç == REPEAT_SKIP) { return !1; } $ÖúÙ–Ã£ = $ì ‡•««[10] . get_path_ext($Ş€Œ…ë›); $ÖúÙ–Ã£ = $ÖúÙ–Ã£ == $ì ‡•««[10] || $¡Ù¡¯Æ– ? $ì ‡•««[12] : $ÖúÙ–Ã£; $öæ¨ÉÊå = 1; $›ä§¨»« = substr($Ş€Œ…ë›, 0, strlen($Ş€Œ…ë›) - strlen($ÖúÙ–Ã£)); $êÇñßšÎ = $›ä§¨»« . "\50{$öæ¨ÉÊå}\x29{$ÖúÙ–Ã£}"; while ($this->exist(rtrim($“¢•ãù½, $ì ‡•««[8]) . $ì ‡•««[8] . $êÇñßšÎ)) { $êÇñßšÎ = $›ä§¨»« . "\x28{$öæ¨ÉÊå}\x29{$ÖúÙ–Ã£}"; $öæ¨ÉÊå++; } return $êÇñßšÎ; } private function fileNameAutoList($Õ÷”Ó’ü, $…¶ôƒÉÎ, $Ğì¦“öû = false) { $ËîØ¼¥È =& $_SERVER[ÆªÈ–¬]; $Í†ßÙê¯ = $this->listPath($Õ÷”Ó’ü, !0); $Í†ßÙê¯ = array_merge($Í†ßÙê¯[$ËîØ¼¥È[85]], $Í†ßÙê¯[$ËîØ¼¥È[86]]); $æ¨ÜáƒÉ = array_to_keyvalue($Í†ßÙê¯, $ËîØ¼¥È[12], $ËîØ¼¥È[32]); $ Ş Ï»– = $ËîØ¼¥È[10] . get_path_ext($…¶ôƒÉÎ); $ Ş Ï»– = $ Ş Ï»– == $ËîØ¼¥È[10] || $Ğì¦“öû ? $ËîØ¼¥È[12] : $ Ş Ï»–; $®è¢Ñª‚ = substr($…¶ôƒÉÎ, 0, strlen($…¶ôƒÉÎ) - strlen($ Ş Ï»–)); $ëùš¥Ñ = $®è¢Ñª‚ . "\50\60\x29{$ Ş Ï»–}"; for ($‹·§õƒ‡ = 1; $‹·§õƒ‡ <= count($æ¨ÜáƒÉ) + 1; $‹·§õƒ‡++) { $ëùš¥Ñ = $®è¢Ñª‚ . "\x28{$‹·§õƒ‡}\x29{$ Ş Ï»–}"; if (!in_array_not_case($ëùš¥Ñ, $æ¨ÜáƒÉ)) { return $ëùš¥Ñ; } } return $ëùš¥Ñ; } public function listAllFiles($ï¿±Ëò£, $ê½Ñ¶ãŒ) { $œ·Í‹ô¥ =& $_SERVER[ÆªÈ–¬]; if (empty($ê½Ñ¶ãŒ)) { return array(); } $Ö«„àâÄ = array_keys($ê½Ñ¶ãŒ); $šºçÕç = array(); $ï¿±Ëò£ = trim($ï¿±Ëò£, $œ·Í‹ô¥[8]); foreach ($ê½Ñ¶ãŒ as $Şöïîò => $«ÅœÈÀ¥) { $¨Ôù™‘• = ltrim(substr(trim($Şöïîò, $œ·Í‹ô¥[8]), strlen($ï¿±Ëò£)), $œ·Í‹ô¥[8]); if (substr($Şöïîò, -1) == $œ·Í‹ô¥[8]) { $¨Ôù™‘• = rtrim($¨Ôù™‘•, $œ·Í‹ô¥[8]) . $œ·Í‹ô¥[8]; } $šºçÕç = array_merge($šºçÕç, $this->slicePath($¨Ôù™‘•)); } $” ¨•ßÖ = array(); foreach (array_unique($šºçÕç) as $ß†¾ïí†) { $çÈïš­ = array($œ·Í‹ô¥[87] => $this->getPathOuter($œ·Í‹ô¥[8] . $ï¿±Ëò£ . $œ·Í‹ô¥[8] . $ß†¾ïí†), $œ·Í‹ô¥[78] => 1, $œ·Í‹ô¥[79] => 0); if (substr($ß†¾ïí†, -1) != $œ·Í‹ô¥[8]) { $çÈïš­[$œ·Í‹ô¥[78]] = 0; $ø§¢Ÿ‰ = $this->getPath($ï¿±Ëò£ . $œ·Í‹ô¥[8] . $ß†¾ïí†); if (isset($ê½Ñ¶ãŒ[$ø§¢Ÿ‰])) { $ÆÃãòğŸ = $ê½Ñ¶ãŒ[$ø§¢Ÿ‰]; if (isset($ÆÃãòğŸ[$œ·Í‹ô¥[79]])) { $çÈïš­[$œ·Í‹ô¥[79]] = intval($ÆÃãòğŸ[$œ·Í‹ô¥[79]]); } if (isset($ÆÃãòğŸ[$œ·Í‹ô¥[206]])) { $çÈïš­[$œ·Í‹ô¥[88]] = intval($ÆÃãòğŸ[$œ·Í‹ô¥[206]]); } } } $” ¨•ßÖ[] = $çÈïš­; } return $” ¨•ßÖ; } public function slicePath($Šœ¦ÎÇ½) { $¢úÂ‰¸Á =& $_SERVER[ÆªÈ–¬]; $è†ª¾ûß = explode($¢úÂ‰¸Á[8], trim($Šœ¦ÎÇ½, $¢úÂ‰¸Á[8])); $‡½šÌ–’ = 0; do { ++$‡½šÌ–’; $Åûáûëî[] = implode($¢úÂ‰¸Á[8], array_slice($è†ª¾ûß, 0, $‡½šÌ–’)) . $¢úÂ‰¸Á[8]; } while ($‡½šÌ–’ < count($è†ª¾ûß)); $Åûáûëî[count($è†ª¾ûß) - 1] = $Šœ¦ÎÇ½; return $Åûáûëî; } public function getHost() { $‚ˆâÂÑÖ =& $_SERVER[ÆªÈ–¬]; $¢Âœ÷£ = parse_url(trim($this->domain, $‚ˆâÂÑÖ[8])); $›§İ‚­ = isset($¢Âœ÷£[$‚ˆâÂÑÖ[207]]) ? $¢Âœ÷£[$‚ˆâÂÑÖ[207]] : http_type(); $‰æğ¨ßâ = isset($¢Âœ÷£[$‚ˆâÂÑÖ[208]]) ? $¢Âœ÷£[$‚ˆâÂÑÖ[208]] : $¢Âœ÷£[$‚ˆâÂÑÖ[87]]; if (isset($¢Âœ÷£[$‚ˆâÂÑÖ[209]])) { $‰æğ¨ßâ .= $‚ˆâÂÑÖ[4] . $¢Âœ÷£[$‚ˆâÂÑÖ[209]]; } return $›§İ‚­ . $‚ˆâÂÑÖ[210] . $‰æğ¨ßâ; } public function pathEncode($•°µîúÅ) { $ÈÎ¤¶ =& $_SERVER[ÆªÈ–¬]; return str_replace($ÈÎ¤¶[211], $ÈÎ¤¶[8], rawurlencode($•°µîúÅ)); } public function writeLog($ß÷£æÂ» = '', $­¸•×ˆã = false) { $ğÚ†í¿Œ =& $_SERVER[ÆªÈ–¬]; $òÉ«ºå = in_array(ACTION, array($ğÚ†í¿Œ[212], $ğÚ†í¿Œ[213])); if (!$òÉ«ºå && !GLOBAL_DEBUG) { return; } $ïıñ­Ê = $ß÷£æÂ»; static $°šñƒÈ = null; if (!$°šñƒÈ) { $°šñƒÈ = strtoupper($this->getType()); } $ß÷£æÂ» = $°šñƒÈ . $ğÚ†í¿Œ[214] . $ß÷£æÂ»; if ($­¸•×ˆã) { $¼¶ãÎ°· = error_get_last(); if ($¼¶ãÎ°·) { $ß÷£æÂ» = array($ß÷£æÂ», $¼¶ãÎ°·); } } write_log($ß÷£æÂ», $ğÚ†í¿Œ[215]); if ($òÉ«ºå) { throw new Exception($ïıñ­Ê); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¥Ñ»—û) { set_timeout(); require_once SDK_DIR . $_SERVER[ÆªÈ–¬][216]; parent::__construct(); $this->_init($¥Ñ»—û); } public function _init($ìœÌ˜›) { $É’ï¯á¼ =& $_SERVER[ÆªÈ–¬]; $this->config = $ìœÌ˜›; foreach ($ìœÌ˜› as $ŒÁÌÍõ => $ù¯ÏŸÈ) { if (isset($this->{$ŒÁÌÍõ})) { $this->{$ŒÁÌÍõ} = $ù¯ÏŸÈ; } } $this->endpoint = $ìœÌ˜›[$É’ï¯á¼[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($É’ï¯á¼[212], $É’ï¯á¼[213]))) { $this->client->setExceptions(); } } public function setSignVersion($‰÷É××µ = "\166\x34") { $this->signVer = $‰÷É××µ; $this->client->setSignatureVersion($‰÷É××µ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $øÃ‡ó´Ü) { return null; } } public function isBucketCors() { $¥‹¿™É· =& $_SERVER[ÆªÈ–¬]; $‘ñ÷áÃ§ = $this->getBucketCors(); if (!$‘ñ÷áÃ§ || !is_array($‘ñ÷áÃ§)) { return !1; } if (!is_array($‘ñ÷áÃ§[$¥‹¿™É·[218]])) { $‘ñ÷áÃ§[$¥‹¿™É·[218]] = explode($¥‹¿™É·[50], $‘ñ÷áÃ§[$¥‹¿™É·[218]]); } if ($‘ñ÷áÃ§[$¥‹¿™É·[219]] != $¥‹¿™É·[220] || !in_array($¥‹¿™É·[220], $‘ñ÷áÃ§[$¥‹¿™É·[218]])) { return !1; } $ÔíÖåÏ = array_map($¥‹¿™É·[221], $‘ñ÷áÃ§[$¥‹¿™É·[222]]); if (!is_array($ÔíÖåÏ)) { $ÔíÖåÏ = array(); } $òÚìïÙ = array($¥‹¿™É·[223], $¥‹¿™É·[224], $¥‹¿™É·[225], $¥‹¿™É·[226], $¥‹¿™É·[227]); $˜¢®ùö€ = array_diff($òÚìïÙ, $ÔíÖåÏ); return empty($˜¢®ùö€); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($£íµíşÔ, $ğº•‡Ÿ” = '', $ĞñÉšÙ± = REPEAT_RENAME) { $ö«êº‚ì = $this->setContent($£íµíşÔ, $ğº•‡Ÿ”); if ($ö«êº‚ì !== !1) { return $this->getPathOuter($£íµíşÔ); } return !1; } public function mkdir($äÜËö¸¦, $ˆİ™¶òæ = REPEAT_SKIP) { $»µÕ»¡ =& $_SERVER[ÆªÈ–¬]; if (empty($äÜËö¸¦) && $äÜËö¸¦ !== $»µÕ»¡[228]) { return !1; } if ($ˆİ™¶òæ && $this->_isFolder($äÜËö¸¦)) { return $this->getPathOuter($äÜËö¸¦); } $üß†æ³¬ = $this->setContent($äÜËö¸¦, $»µÕ»¡[12], !0); if ($üß†æ³¬ !== !1) { return $this->getPathOuter($äÜËö¸¦); } return !1; } public function copyFile($Á¸Ì„ ×, $¡œ­ÍÚ, $œ®‘Ù¸¾ = array()) { $²ôĞÕ‘ =& $_SERVER[ÆªÈ–¬]; $ÎĞã®õ‰ = $this->objectMeta($Á¸Ì„ ×); if (!$ÎĞã®õ‰) { return !1; } if ($ÎĞã®õ‰[$²ôĞÕ‘[79]] <= 1024 * 1024 * 200) { $Ú­æô‘Á = $this->client->copyObject($this->bucket, $Á¸Ì„ ×, $this->bucket, $¡œ­ÍÚ, $²ôĞÕ‘[229], $œ®‘Ù¸¾); } else { $Ú­æô‘Á = $this->client->multiCopyObject($this->bucket, $Á¸Ì„ ×, $this->bucket, $¡œ­ÍÚ, $œ®‘Ù¸¾); } $Ú­æô‘Á = $Ú­æô‘Á ? $this->getPathOuter($¡œ­ÍÚ) : !1; return $Ú­æô‘Á; } public function moveFile($­£ğúĞ, $Şüâà›¯) { if ($this->copyFile($­£ğúĞ, $Şüâà›¯)) { $this->delFile($­£ğúĞ); return $this->getPathOuter($Şüâà›¯); } return !1; } public function delFile($‡ÃÔıû) { return $this->client->deleteObject($this->bucket, $‡ÃÔıû); } public function delFolder($•ı¥ùß) { $ŞæŒÂÌ =& $_SERVER[ÆªÈ–¬]; if (!$this->exist($•ı¥ùß)) { return !0; } $this->listItemCache = !1; $õî’¤éü = $this->fileList($•ı¥ùß); $this->listItemCache = !0; $®šÇØÌê = trim($•ı¥ùß, $ŞæŒÂÌ[8]) . $ŞæŒÂÌ[8]; if (!empty($•ı¥ùß) && $•ı¥ùß !== $ŞæŒÂÌ[228] && !in_array($®šÇØÌê, $õî’¤éü[$ŞæŒÂÌ[85]])) { $õî’¤éü[$ŞæŒÂÌ[85]][] = $®šÇØÌê; } $ƒÉŞ½àë = $this->delByBatch($õî’¤éü[$ŞæŒÂÌ[86]]); if (!$ƒÉŞ½àë) { return !1; } $ƒÉŞ½àë = $this->delByBatch($õî’¤éü[$ŞæŒÂÌ[85]]); if (!$ƒÉŞ½àë) { return !1; } return $this->delFile($®šÇØÌê); } private function delByBatch($şÇ˜Š¥œ) { foreach (array_chunk($şÇ˜Š¥œ, 1000) as $¥¾µª“õ) { $ÎÔ¦å¢Ì = $this->client->deleteObjects($this->bucket, $¥¾µª“õ); if (!$ÎÔ¦å¢Ì) { return !1; } } return !0; } public function rename($œ¤ç¾üÇ, $öéã‘Õè) { return $this->renameObject($œ¤ç¾üÇ, $öéã‘Õè); } public function listPath($ÉµãËä, $£ÕÚ×ŸÙ = false) { $ÀœÅ’¹‡ =& $_SERVER[ÆªÈ–¬]; $¥÷´å®¾ = $this->fileList($ÉµãËä, $ÀœÅ’¹‡[8], !0); foreach ($¥÷´å®¾[$ÀœÅ’¹‡[85]] as $ßÚ­’ËĞ => $‘ÛÜİ×ú) { $¥÷´å®¾[$ÀœÅ’¹‡[85]][$ßÚ­’ËĞ] = $this->folderInfo($‘ÛÜİ×ú, $£ÕÚ×ŸÙ, $‘ÛÜİ×ú); } foreach ($¥÷´å®¾[$ÀœÅ’¹‡[86]] as $ßÚ­’ËĞ => $‘ÛÜİ×ú) { $¥÷´å®¾[$ÀœÅ’¹‡[86]][$ßÚ­’ËĞ] = $this->fileInfo($‘ÛÜİ×ú[$ÀœÅ’¹‡[32]], $£ÕÚ×ŸÙ, $‘ÛÜİ×ú); } return $¥÷´å®¾; } protected function infoChildren($ÜõÓâ”‰, &$›âÔá€) { $‘õ¤°¯å =& $_SERVER[ÆªÈ–¬]; $óÎíÎ¥Õ = $this->fileList($ÜõÓâ”‰, $‘õ¤°¯å[12], !0); $›âÔá€[$‘õ¤°¯å[81]] += count($óÎíÎ¥Õ[$‘õ¤°¯å[85]]); $›âÔá€[$‘õ¤°¯å[80]] += count($óÎíÎ¥Õ[$‘õ¤°¯å[86]]); foreach ($óÎíÎ¥Õ[$‘õ¤°¯å[86]] as $õøÈê ô) { if (!$õøÈê ô || !$õøÈê ô[$‘õ¤°¯å[79]]) { continue; } $›âÔá€[$‘õ¤°¯å[79]] += $õøÈê ô[$‘õ¤°¯å[79]]; } } private function fileInfo($ã–°Îœ¿, $ ÂÎ™ò° = false, $‰¬ùÊ = array()) { $ì ¨Ì…û =& $_SERVER[ÆªÈ–¬]; $èËçÓş = array($ì ¨Ì…û[32] => $this->pathThis($ã–°Îœ¿), $ì ¨Ì…û[87] => $this->getPathOuter($ã–°Îœ¿), $ì ¨Ì…û[33] => $ì ¨Ì…û[230], $ì ¨Ì…û[169] => $this->ext($ã–°Îœ¿), $ì ¨Ì…û[79] => isset($‰¬ùÊ[$ì ¨Ì…û[79]]) ? $‰¬ùÊ[$ì ¨Ì…û[79]] : 0); if ($ ÂÎ™ò°) { return $èËçÓş; } $èËçÓş[$ì ¨Ì…û[231]] = $èËçÓş[$ì ¨Ì…û[88]] = 0; $èËçÓş[$ì ¨Ì…û[232]] = $èËçÓş[$ì ¨Ì…û[233]] = !0; if (empty($‰¬ùÊ)) { $‰¬ùÊ = $this->objectMeta($ã–°Îœ¿); if (!$‰¬ùÊ) { return $èËçÓş; } } if (isset($‰¬ùÊ[$ì ¨Ì…û[234]]) && $‰¬ùÊ[$ì ¨Ì…û[234]]) { $èËçÓş[$ì ¨Ì…û[235]] = $‰¬ùÊ[$ì ¨Ì…û[234]]; } if (isset($‰¬ùÊ[$ì ¨Ì…û[206]])) { $èËçÓş[$ì ¨Ì…û[88]] = $‰¬ùÊ[$ì ¨Ì…û[206]]; } if (isset($‰¬ùÊ[$ì ¨Ì…û[79]])) { $èËçÓş[$ì ¨Ì…û[79]] = $‰¬ùÊ[$ì ¨Ì…û[79]]; } return $èËçÓş; } private function folderInfo($È÷ÛŠë“, $¾‘†àáí = false, $Èº’©¶ô = array()) { $ÏÌ¨ˆÒ =& $_SERVER[ÆªÈ–¬]; $¯§»™Î = array($ÏÌ¨ˆÒ[32] => $this->pathThis($È÷ÛŠë“), $ÏÌ¨ˆÒ[87] => $this->getPathOuter($ÏÌ¨ˆÒ[8] . $È÷ÛŠë“), $ÏÌ¨ˆÒ[33] => $ÏÌ¨ˆÒ[78]); if ($¾‘†àáí) { return $¯§»™Î; } $¯§»™Î[$ÏÌ¨ˆÒ[231]] = $¯§»™Î[$ÏÌ¨ˆÒ[88]] = 0; $¯§»™Î[$ÏÌ¨ˆÒ[232]] = $¯§»™Î[$ÏÌ¨ˆÒ[233]] = !0; if ($È÷ÛŠë“ == $ÏÌ¨ˆÒ[12]) { return $¯§»™Î; } if (empty($Èº’©¶ô)) { $Èº’©¶ô = $this->objectMeta(trim($È÷ÛŠë“, $ÏÌ¨ˆÒ[8]) . $ÏÌ¨ˆÒ[8]); } if (isset($Èº’©¶ô[$ÏÌ¨ˆÒ[206]])) { $¯§»™Î[$ÏÌ¨ˆÒ[231]] = $Èº’©¶ô[$ÏÌ¨ˆÒ[206]]; } return $¯§»™Î; } private function fileList($¸ÌóƒÃ€, $·„Â„¼Í = '', $üÈÏ·™ß = 0) { $åó½Éëì =& $_SERVER[ÆªÈ–¬]; $¥°Ã¬Ğ„ = rtrim($¸ÌóƒÃ€, $åó½Éëì[8]) . $åó½Éëì[8]; $™Šéì­° = $this->listObjs($¥°Ã¬Ğ„, null, null, $·„Â„¼Í); if (!$™Šéì­°) { return array($åó½Éëì[85] => array(), $åó½Éëì[86] => array()); } $†´ù¡Àı = $Ù¼íå¬† = array(); foreach ($™Šéì­°[$åó½Éëì[236]] as $™œÔ§¦ï) { $–§–ıŸ­ = $™œÔ§¦ï[$åó½Éëì[32]]; if ($–§–ıŸ­ == $¥°Ã¬Ğ„) { continue; } $Ü•¤’§“ = isset($™œÔ§¦ï[$åó½Éëì[79]]) ? $™œÔ§¦ï[$åó½Éëì[79]] : 0; $ŒéĞ¡¶ = $Ü•¤’§“ == 0 && substr($–§–ıŸ­, strlen($–§–ıŸ­) - 1, 1) == $åó½Éëì[8] ? !0 : !1; $this->cacheMethodInfoSet($–§–ıŸ­, $ŒéĞ¡¶, $™œÔ§¦ï); if ($ŒéĞ¡¶) { $†´ù¡Àı[] = $–§–ıŸ­; continue; } $Ù¼íå¬†[] = $üÈÏ·™ß ? $™œÔ§¦ï : $–§–ıŸ­; } foreach ($™Šéì­°[$åó½Éëì[237]] as $™œÔ§¦ï) { $†´ù¡Àı[] = $™œÔ§¦ï[$åó½Éëì[32]]; $this->cacheMethodInfoSet($™œÔ§¦ï[$åó½Éëì[32]], !0); } $this->cacheMethodInfoSet($¸ÌóƒÃ€, !0); return array($åó½Éëì[85] => $†´ù¡Àı, $åó½Éëì[86] => $Ù¼íå¬†); } private function listObjs($¤ÄÌæ¨†, $¹ƒŒñàŒ = null, $åğ¬Îëé = null, $ÖåÊ¥“ = null) { $ûÔ¤°á¢ =& $_SERVER[ÆªÈ–¬]; $¤ÄÌæ¨† = trim($¤ÄÌæ¨†, $ûÔ¤°á¢[8]); $ì£‰Î‡Ğ = empty($¤ÄÌæ¨†) && $¤ÄÌæ¨† !== $ûÔ¤°á¢[228] ? $ûÔ¤°á¢[12] : $¤ÄÌæ¨† . $ûÔ¤°á¢[8]; return $this->client->getBucket($this->bucket, $ì£‰Î‡Ğ, $¹ƒŒñàŒ, $åğ¬Îëé, $ÖåÊ¥“, !0); } public function has($É¿ùøÛÓ, $àõ¤¾ƒù = false, $´ÈºÙñœ = true) { $ï•­ =& $_SERVER[ÆªÈ–¬]; $É¿ùøÛÓ = trim($É¿ùøÛÓ, $ï•­[8]); $†ÃêÍÒº = empty($É¿ùøÛÓ) && $É¿ùøÛÓ !== $ï•­[228] ? $ï•­[12] : $É¿ùøÛÓ . $ï•­[8]; $‰ÛÁÂü = null; $‘çÍÕ­Ò = 500; $û–é™ÃÈ = $ï•­[8]; $ İ³€¶ = $å’œüÓ› = array(); while (!0) { $ü¼†İÜñ = $this->listObjs($É¿ùøÛÓ, $‰ÛÁÂü, $‘çÍÕ­Ò, $û–é™ÃÈ); if (!$ü¼†İÜñ) { break; } $‰ÛÁÂü = $ü¼†İÜñ[$ï•­[238]]; $ø¢Ô¾ŠŸ = $ü¼†İÜñ[$ï•­[236]]; $‹„›¾Å³ = $ü¼†İÜñ[$ï•­[237]]; if (empty($ø¢Ô¾ŠŸ) && empty($‹„›¾Å³)) { break; } if (count($ø¢Ô¾ŠŸ) == 1 && $ø¢Ô¾ŠŸ[0][$ï•­[32]] == $†ÃêÍÒº) { break; } if ($àõ¤¾ƒù) { if (count($ø¢Ô¾ŠŸ)) { $ø¢Ô¾ŠŸ = array_column($ø¢Ô¾ŠŸ, $ï•­[32]); $ İ³€¶ = array_merge($ İ³€¶, $ø¢Ô¾ŠŸ); } if (count($‹„›¾Å³)) { $‹„›¾Å³ = array_column($‹„›¾Å³, $ï•­[32]); $å’œüÓ› = array_merge($å’œüÓ›, $‹„›¾Å³); } if ($‰ÛÁÂü === null) { break; } continue; } if ($´ÈºÙñœ) { if (!empty($ø¢Ô¾ŠŸ)) { if (count($ø¢Ô¾ŠŸ) > 1 || isset($ø¢Ô¾ŠŸ[0][$ï•­[32]]) && $ø¢Ô¾ŠŸ[0][$ï•­[32]] != $†ÃêÍÒº) { return !0; } } } else { if (!empty($‹„›¾Å³)) { return !0; } } if ($‰ÛÁÂü === null) { break; } } if ($àõ¤¾ƒù) { $ İ³€¶ = array_diff($ İ³€¶, array($†ÃêÍÒº)); $ İ³€¶ = count(array_unique($ İ³€¶)); $å’œüÓ› = count(array_unique($å’œüÓ›)); return array($ï•­[239] => $ İ³€¶, $ï•­[240] => $å’œüÓ›); } return !1; } public function listAll($³Êâˆ€û) { $¬…¢Öã =& $_SERVER[ÆªÈ–¬]; $ˆ–İâÏ… = $this->fileList($³Êâˆ€û, $¬…¢Öã[12], !0); $ïşäšÉ = array_to_keyvalue($ˆ–İâÏ…[$¬…¢Öã[86]], $¬…¢Öã[32]); foreach ($ˆ–İâÏ…[$¬…¢Öã[85]] as $²íü…£¯) { if (is_string($²íü…£¯)) { $ïşäšÉ[$²íü…£¯] = array($¬…¢Öã[79] => 0); } } return $this->listAllFiles($³Êâˆ€û, $ïşäšÉ); } public function canRead($’úœõÓ®) { $ıúüÖÉÀ =& $_SERVER[ÆªÈ–¬]; $İ«Ûœ° = $this->client->getAccessControlPolicy($this->bucket, $’úœõÓ®); if (!$İ«Ûœ°) { return !1; } return in_array($İ«Ûœ°, array($ıúüÖÉÀ[241], $ıúüÖÉÀ[242], $ıúüÖÉÀ[243])) ? !0 : !1; } public function canWrite($ÆÉ›šØ©) { $’ÇıÛñ¯ =& $_SERVER[ÆªÈ–¬]; $¨–”Ú¤± = $this->client->getAccessControlPolicy($this->bucket, $ÆÉ›šØ©); if (!$¨–”Ú¤±) { return !1; } return in_array($¨–”Ú¤±, array($’ÇıÛñ¯[241], $’ÇıÛñ¯[242])) ? !0 : !1; } public function getContent($Û’ºçÆô) { return $this->client->getObject($this->bucket, $Û’ºçÆô); } public function setContent($²Ô«¤Ê—, $êŒç„ï = '', $ºìºéò— = false) { $€¤ı¾± =& $_SERVER[ÆªÈ–¬]; $²Ô«¤Ê— = $ºìºéò— ? trim($²Ô«¤Ê—, $€¤ı¾±[8]) . $€¤ı¾±[8] : $²Ô«¤Ê—; $„Åëßş… = get_file_mime(get_path_ext($²Ô«¤Ê—)); $Ö°Ä½óË = $this->client->putObject($êŒç„ï, $this->bucket, $²Ô«¤Ê—, $€¤ı¾±[229], array(), $„Åëßş…); if (!$Ö°Ä½óË) { return !1; } if ($ºìºéò—) { return !0; } return $Ö°Ä½óË ? !0 : !1; } public function fileSubstr($Ë‹Í‡–, $ô€±„è, $§€×£Ä¦) { $ˆ¯÷•ƒì = $ô€±„è + $§€×£Ä¦ - 1; return $this->client->getObject($this->bucket, $Ë‹Í‡–, array($_SERVER[ÆªÈ–¬][244] => "\x62\x79\x74\145\163\75{$ô€±„è}\55{$ˆ¯÷•ƒì}")); } public function upload($ô‘ï×µÓ, $ÜÄ³¦ç, $ƒ´œÑ‡Œ = false, $¦éëºùÍ = REPEAT_REPLACE) { $‡¼Ñ‚‘ =& $_SERVER[ÆªÈ–¬]; $Ùş´¯ñ— = array($‡¼Ñ‚‘[245] => @md5_file($ÜÄ³¦ç)); $ö–µ‹â° = array($‡¼Ñ‚‘[246] => get_file_mime(get_path_ext($ô‘ï×µÓ))); if (IO::size($ÜÄ³¦ç) <= 1024 * 1024 * 200) { $µÎúˆÏ = $this->client->putObjectFile($ÜÄ³¦ç, $this->bucket, $ô‘ï×µÓ, $‡¼Ñ‚‘[229], $Ùş´¯ñ—, $ö–µ‹â°); return !empty($µÎúˆÏ) ? $this->getPathOuter($ô‘ï×µÓ) : !1; } $éˆÀ°‡µ = $this->client->multiUploadObject($ÜÄ³¦ç, $this->bucket, trim($ô‘ï×µÓ, $‡¼Ñ‚‘[8]), $Ùş´¯ñ—, $ö–µ‹â°); return $éˆÀ°‡µ ? $this->getPathOuter($ô‘ï×µÓ) : !1; } public function download($ğİµÂõ, $¨‘íÙüñ) { if (!@is_dir($this->pathFather($¨‘íÙüñ)) && !IO::mkdir($this->pathFather($¨‘íÙüñ))) { return !1; } $ÓİÂÈáø = $this->client->getObject($this->bucket, $ğİµÂõ, array(), $¨‘íÙüñ); return $ÓİÂÈáø !== !1 ? $¨‘íÙüñ : !1; } public function link($ÒÓÔ€ÛÊ, $ØÀ¾œ¥‘ = array()) { $©¹—€¼ =& $_SERVER[ÆªÈ–¬]; if ($this->signVer == $©¹—€¼[247]) { return $this->client->getAuthenticatedURL($this->bucket, $ÒÓÔ€ÛÊ, 3600 * 12, $ØÀ¾œ¥‘); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÒÓÔ€ÛÊ, $©¹—€¼[8]), 3600 * 12, $this->region, array(), !0, $ØÀ¾œ¥‘); } public function fileOut($ˆÃ³Ùñù, $±¶ÄÅ² = false, $¯¢ß¦× = false, $ ïâÃô = '') { $­¥ù±œŞ =& $_SERVER[ÆªÈ–¬]; if ($this->isFileOutServer()) { return $this->fileOutServer($ˆÃ³Ùñù, $±¶ÄÅ², $¯¢ß¦×, $ ïâÃô); } if (!$¯¢ß¦×) { $¯¢ß¦× = $this->pathThis($ˆÃ³Ùñù); } $ ¹„¬¾´ = get_file_mime(get_path_ext($¯¢ß¦×)); if ($ ¹„¬¾´ == $­¥ù±œŞ[248]) { return parent::fileOut($ˆÃ³Ùñù, $±¶ÄÅ², $¯¢ß¦×, $ ïâÃô); } $¤ïµöÌ = array($­¥ù±œŞ[249] => $ ¹„¬¾´); if ($±¶ÄÅ²) { $¤ïµöÌ[$­¥ù±œŞ[250]] = $­¥ù±œŞ[251] . rawurlencode($¯¢ß¦×); } else { } $¥ø˜ÂŠ“ = $this->link($ˆÃ³Ùñù, $¤ïµöÌ); $this->fileOutLink($¥ø˜ÂŠ“); } public function fileOutServer($›ğÉˆÊè, $°»Á‚üô = false, $ü¨‚ßÒê = false, $ˆÏó²Ÿâ = '') { parent::fileOut($›ğÉˆÊè, $°»Á‚üô, $ü¨‚ßÒê, $ˆÏó²Ÿâ); } public function fileOutImageServer($ÉÎÉêü, $ˆ¸½Î¼ë = 250) { parent::fileOutImage($ÉÎÉêü, $ˆ¸½Î¼ë); } public function hashMd5($ÑÌ¡Ç×, $ùÜãÜáÄ = '') { $‘Ûñõ¶Œ = $this->objectMeta($ÑÌ¡Ç×); if (!$‘Ûñõ¶Œ) { return !1; } $ùÜãÜáÄ = $ùÜãÜáÄ ? $ùÜãÜáÄ : _get($‘Ûñõ¶Œ, $_SERVER[ÆªÈ–¬][252]); return $ùÜãÜáÄ; } public function uploadFormData($´ô¨´Ã‘, $„Î›± º = 3600) { $¥¢úß‹É =& $_SERVER[ÆªÈ–¬]; $‹æöÜ«õ = $this->pathFather($´ô¨´Ã‘); $õ§ÊáÌ = $this->client->getHttpUploadPostParams($this->bucket, $‹æöÜ«õ, $¥¢úß‹É[229], $„Î›± º); return array_merge((array) $õ§ÊáÌ, array($¥¢úß‹É[208] => $this->getHost())); } public function multiUploadFormData($ôÈËİƒæ, $œöù·–£ = 3600) { $Æßß¼¢® =& $_SERVER[ÆªÈ–¬]; $ˆùÚˆÏİ = gmdate($Æßß¼¢®[253]); $‰À™íó = array(); $ˆœûß±³ = $this->client->getUploadId($this->bucket, $ôÈËİƒæ, $‰À™íó); if (!$ˆœûß±³) { return !1; } return array($Æßß¼¢®[254] => $ˆœûß±³, $Æßß¼¢®[208] => $this->getHost() . $Æßß¼¢®[8] . $this->pathEncode($ôÈËİƒæ), $Æßß¼¢®[255] => $ˆùÚˆÏİ, $Æßß¼¢®[97] => $ôÈËİƒæ); } public function multiUploadAuthData($¤æó†Şğ, $»™ÂôŠ‰ = array()) { $È¸Æ—æä =& $_SERVER[ÆªÈ–¬]; $Ÿ‹Ñ·äÎ = isset($»™ÂôŠ‰[$È¸Æ—æä[255]]) ? $»™ÂôŠ‰[$È¸Æ—æä[255]] : gmdate($È¸Æ—æä[253]); $‘¦µı¹ = isset($»™ÂôŠ‰[$È¸Æ—æä[169]]) ? $»™ÂôŠ‰[$È¸Æ—æä[169]] : $È¸Æ—æä[12]; $ªÈÌéû = $»™ÂôŠ‰[$È¸Æ—æä[97]]; unset($»™ÂôŠ‰[$È¸Æ—æä[97]]); if (isset($»™ÂôŠ‰[$È¸Æ—æä[256]])) { $»™ÂôŠ‰[$È¸Æ—æä[255]] = $Ÿ‹Ñ·äÎ; return $this->listUploadParts($ªÈÌéû, $»™ÂôŠ‰); } $…’ÒôÉ = array($È¸Æ—æä[257], $È¸Æ—æä[12], $È¸Æ—æä[123], $È¸Æ—æä[12], "\x78\x2d\141\x6d\x7a\x2d\x64\x61\164\145\x3a{$Ÿ‹Ñ·äÎ}", $È¸Æ—æä[8] . $this->bucket . $È¸Æ—æä[8] . $this->pathEncode($ªÈÌéû) . $‘¦µı¹); if (strpos($‘¦µı¹, $È¸Æ—æä[258]) === 0) { $…’ÒôÉ[0] = $È¸Æ—æä[259]; } if (isset($»™ÂôŠ‰[$È¸Æ—æä[260]]) && $»™ÂôŠ‰[$È¸Æ—æä[260]] == $È¸Æ—æä[261]) { $…’ÒôÉ[0] = $È¸Æ—æä[261]; } $Ê§‹Ãó¦ = implode($È¸Æ—æä[262], $…’ÒôÉ); $¦üû­™– = base64_encode(hash_hmac($È¸Æ—æä[263], $Ê§‹Ãó¦, $this->secret, !0)); $ºïô”Í  = $È¸Æ—æä[264] . $this->accessKey . $È¸Æ—æä[4] . $¦üû­™–; if (strpos($‘¦µı¹, $È¸Æ—æä[258]) === 0) { return array($È¸Æ—æä[265] => $ºïô”Í , $È¸Æ—æä[255] => $Ÿ‹Ñ·äÎ); } return $ºïô”Í ; } public function listUploadParts($“ƒå˜è, $»“Æ€Ï = array()) { $Ïö÷´¬¦ =& $_SERVER[ÆªÈ–¬]; $ÛöÜ­€ = str_replace($Ïö÷´¬¦[266], $Ïö÷´¬¦[12], $»“Æ€Ï[$Ïö÷´¬¦[169]]); $§Ø÷ÇĞ½ = $this->client->listParts($this->bucket, $“ƒå˜è, $ÛöÜ­€); if (!$§Ø÷ÇĞ½) { return !1; } unset($»“Æ€Ï[$Ïö÷´¬¦[256]], $»“Æ€Ï[$Ïö÷´¬¦[260]]); $»“Æ€Ï[$Ïö÷´¬¦[97]] = $“ƒå˜è; $ÌÈ¤Ê‘Î = $this->multiUploadAuthData($“ƒå˜è, $»“Æ€Ï); if (empty($ÌÈ¤Ê‘Î)) { return !1; } return array($Ïö÷´¬¦[265] => $ÌÈ¤Ê‘Î, $Ïö÷´¬¦[255] => $»“Æ€Ï[$Ïö÷´¬¦[255]], $Ïö÷´¬¦[267] => $§Ø÷ÇĞ½); } public function getHost() { $ßÙÇı‰ =& $_SERVER[ÆªÈ–¬]; $áÌ™ëõ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ßÙÇı‰[70], $ßÙÇı‰[64], $ßÙÇı‰[69], $ßÙÇı‰[62]))) { return $áÌ™ëõ . $ßÙÇı‰[8] . $this->bucket; } $áÌ™ëõ = explode($ßÙÇı‰[210], $áÌ™ëõ); return $áÌ™ëõ[0] . $ßÙÇı‰[210] . $this->bucket . $ßÙÇı‰[10] . $áÌ™ëõ[1]; } public function size($ö×™ìÁ‹) { $í¢ÖÄÀˆ = $this->objectMeta($ö×™ìÁ‹); return $í¢ÖÄÀˆ ? $í¢ÖÄÀˆ[$_SERVER[ÆªÈ–¬][79]] : 0; } public function info($Ô‰ìÕä“) { if ($this->isFolder($Ô‰ìÕä“)) { return $this->folderInfo($Ô‰ìÕä“); } else { if ($this->isFile($Ô‰ìÕä“)) { return $this->fileInfo($Ô‰ìÕä“); } } return !1; } public function exist($Éåîï½) { return $this->isFile($Éåîï½) || $this->isFolder($Éåîï½); } public function isFile($øÛçÁù…) { return !$this->isFolder($øÛçÁù…) && $this->objectMeta($øÛçÁù…); } public function isFolder($“Àšï·) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][179], $“Àšï·); } protected function objectMeta($·ìõÓšÅ) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][181], $·ìõÓšÅ); } protected function _objectMeta($³ƒõû) { $®¦À°“ =& $_SERVER[ÆªÈ–¬]; $³ƒõû = rtrim($³ƒõû, $®¦À°“[8]); try { $ú–¶óÀÑ = $this->client->getObjectInfo($this->bucket, $³ƒõû); if (!isset($ú–¶óÀÑ[$®¦À°“[252]]) && isset($ú–¶óÀÑ[$®¦À°“[268]])) { $ú–¶óÀÑ[$®¦À°“[252]] = $ú–¶óÀÑ[$®¦À°“[268]]; } } catch (Exception $ŒåúÂ…é) { $ú–¶óÀÑ = !1; } if (!$ú–¶óÀÑ) { } return $ú–¶óÀÑ; } protected function _isFolder($¥ÑÁæ‘) { $Äˆ ßšş =& $_SERVER[ÆªÈ–¬]; $¥ÑÁæ‘ = rtrim($¥ÑÁæ‘, $Äˆ ßšş[8]); if ($¥ÑÁæ‘ == $Äˆ ßšş[12] || $¥ÑÁæ‘ == $Äˆ ßšş[8]) { return !0; } $®ï…Ìú = $this->client->getBucket($this->bucket, $¥ÑÁæ‘, null, 1); if (empty($®ï…Ìú[$Äˆ ßšş[236]])) { return !1; } $‹ ÏÔ’ = $®ï…Ìú[$Äˆ ßšş[236]][0][$Äˆ ßšş[32]]; return stripos($‹ ÏÔ’, $¥ÑÁæ‘ . $Äˆ ßšş[8]) === 0 ? !0 : !1; if (substr($‹ ÏÔ’, -1) == $Äˆ ßšş[8]) { return !0; } if (get_path_this($‹ ÏÔ’) == get_path_this($¥ÑÁæ‘)) { return !1; } return !0; } public function listObject($„ªñı’¦) { return $this->fileList($„ªñı’¦, $_SERVER[ÆªÈ–¬][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¹ö¶ÓùË) { $Ãô¾Ó€Û =& $_SERVER[ÆªÈ–¬]; parent::__construct($¹ö¶ÓùË); $this->setSignVersion($Ãô¾Ó€Û[247]); if (!$this->region) { $this->region = $Ãô¾Ó€Û[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $‹¹ÈüÍú = $this->getBucketRgn(); return $this->region == $‹¹ÈüÍú ? !0 : !1; } public function uploadFormData($Óû£şé, $•¡‘ˆÆÛ = 3600) { $›Ä÷ÖÜı =& $_SERVER[ÆªÈ–¬]; $›Ò‰åıû = $›Ä÷ÖÜı[229]; $ş¿úîßÇ = $›Ä÷ÖÜı[270]; $”±„†é“ = $›Ä÷ÖÜı[62]; $¼¼Ú¬•¤ = gmdate($›Ä÷ÖÜı[271]); $…–Ë†· = gmdate($›Ä÷ÖÜı[272]); $Ú´ûíşò = $›Ä÷ÖÜı[273]; $›ÆÍê„ = $•¡‘ˆÆÛ . $›Ä÷ÖÜı[12]; $‚÷¢÷Ì = $›Ä÷ÖÜı[274]; $ˆ»íáôä = array($this->accessKey, $…–Ë†·, $this->region, $”±„†é“, $Ú´ûíşò); $‰²š = implode($›Ä÷ÖÜı[8], $ˆ»íáôä); $õ†‚àÃŒ = array($›Ä÷ÖÜı[275] => gmdate($›Ä÷ÖÜı[276], strtotime($›Ä÷ÖÜı[277])), $›Ä÷ÖÜı[278] => array(array($›Ä÷ÖÜı[279] => $this->bucket), array($›Ä÷ÖÜı[280] => $›Ò‰åıû), array($›Ä÷ÖÜı[281], $›Ä÷ÖÜı[282], $›Ä÷ÖÜı[12]), array($›Ä÷ÖÜı[281], $›Ä÷ÖÜı[283], $›Ä÷ÖÜı[12]), array($›Ä÷ÖÜı[281], $›Ä÷ÖÜı[284], $›Ä÷ÖÜı[12]), array($›Ä÷ÖÜı[285] => $‚÷¢÷Ì), array($›Ä÷ÖÜı[286] => $‰²š), array($›Ä÷ÖÜı[287] => $ş¿úîßÇ), array($›Ä÷ÖÜı[288] => $¼¼Ú¬•¤), array($›Ä÷ÖÜı[289] => $›ÆÍê„))); $òˆÔÃà£ = base64_encode(json_encode($õ†‚àÃŒ)); $ÛÚîèº§ = hash_hmac($›Ä÷ÖÜı[290], $…–Ë†·, $›Ä÷ÖÜı[291] . $this->secret, !0); $ÃÎì™á = hash_hmac($›Ä÷ÖÜı[290], $this->region, $ÛÚîèº§, !0); $§áÊç›Š = hash_hmac($›Ä÷ÖÜı[290], $”±„†é“, $ÃÎì™á, !0); $Ó˜ôùÒÆ = hash_hmac($›Ä÷ÖÜı[290], $Ú´ûíşò, $§áÊç›Š, !0); $Àá«İäÃ = hash_hmac($›Ä÷ÖÜı[290], $òˆÔÃà£, $Ó˜ôùÒÆ); $Àß‚ı›À = array($›Ä÷ÖÜı[246] => $›Ä÷ÖÜı[12], $›Ä÷ÖÜı[292] => $›Ä÷ÖÜı[12], $›Ä÷ÖÜı[280] => $›Ò‰åıû, $›Ä÷ÖÜı[285] => $‚÷¢÷Ì, $›Ä÷ÖÜı[293] => $òˆÔÃà£, $›Ä÷ÖÜı[294] => $‰²š, $›Ä÷ÖÜı[295] => $ş¿úîßÇ, $›Ä÷ÖÜı[296] => $¼¼Ú¬•¤, $›Ä÷ÖÜı[297] => $›ÆÍê„, $›Ä÷ÖÜı[298] => $Àá«İäÃ, $›Ä÷ÖÜı[208] => $this->getHost()); return $Àß‚ı›À; } } goto E£à†²„Œ©; Cåçêì˜¶İ: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ª§ã­ëÔ) { parent::__construct($ª§ã­ëÔ); $this->setSignVersion($_SERVER[ÆªÈ–¬][247]); } public function uploadLink($¾á³ÀğÂ, $Ì¯ĞÔƒ¾ = 0) { $ØĞºà¶¤ =& $_SERVER[ÆªÈ–¬]; if ($this->isUploadServer()) { return; } $¸¶¢  ‹ = $this->getType(); if (!in_array($¸¶¢  ‹, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $­ä«ğ» = (!$Ì¯ĞÔƒ¾ ? 1 : ceil($Ì¯ĞÔƒ¾ / pow(1024, 3))) * 3600 * 4; $„ûìÜƒÕ = $this->multiUploadFormData($¾á³ÀğÂ, $­ä«ğ»); if ($„ûìÜƒÕ) { $„ûìÜƒÕ[$ØĞºà¶¤[97]] = $¾á³ÀğÂ; $„ûìÜƒÕ[$ØĞºà¶¤[98]] = $¸¶¢  ‹; } return $„ûìÜƒÕ; } public function fileOutImage($Â”âÓòª, $¹ó÷Š¯ = 250) { if ($this->size($Â”âÓòª) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Â”âÓòª, $¹ó÷Š¯); } $ÉşÖ´ëØ = $this->link($Â”âÓòª); $ÉşÖ´ëØ .= $_SERVER[ÆªÈ–¬][1444] . $¹ó÷Š¯; $this->fileOutLink($ÉşÖ´ëØ); } public function fileOutLink($˜ˆ««») { $‡¼™êÏÍ =& $_SERVER[ÆªÈ–¬]; if (substr($˜ˆ««», 0, 7) == $‡¼™êÏÍ[313]) { $˜ˆ««» = $‡¼™êÏÍ[314] . substr($˜ˆ««», 7); } header($‡¼™êÏÍ[175] . $˜ˆ««»); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($†Ä» ¶) { if (substr($†Ä» ¶, 0, 2) == $_SERVER[ÆªÈ–¬][1403]) { $†Ä» ¶ = BASIC_PATH . substr($†Ä» ¶, 2); } return $†Ä» ¶; } public function iconvApp($÷œ÷Íú) { $¿ŠËöà =& $_SERVER[ÆªÈ–¬]; global $config; return $this->iconvTo($÷œ÷Íú, $config[$¿ŠËöà[1430]], $config[$¿ŠËöà[1429]]); } public function iconvSystem($Öû•á˜‡) { $¾åù™†§ =& $_SERVER[ÆªÈ–¬]; global $config; return $this->iconvTo($Öû•á˜‡, $config[$¾åù™†§[1429]], $config[$¾åù™†§[1430]]); } public function getPathOuter($“Á¡¦•) { $úìıœÚ• =& $_SERVER[ÆªÈ–¬]; $Ş¿ÏÅÁŸ = $this->iconvApp($this->pathBase); $“Á¡¦• = $this->iconvApp($“Á¡¦•); if (substr($Ş¿ÏÅÁŸ, 0, 2) == $úìıœÚ•[1403]) { $Ş¿ÏÅÁŸ = BASIC_PATH . substr($Ş¿ÏÅÁŸ, 2); } if (substr($“Á¡¦•, 0, 2) == $úìıœÚ•[1403]) { $“Á¡¦• = BASIC_PATH . substr($“Á¡¦•, 2); } $Ş¿ÏÅÁŸ = KodIO::clear($Ş¿ÏÅÁŸ); $“Á¡¦• = KodIO::clear($“Á¡¦•); $“Á¡¦• = substr($“Á¡¦•, strlen($Ş¿ÏÅÁŸ)); if (empty($this->pathDriver)) { return $“Á¡¦•; } return $this->pathDriver . $úìıœÚ•[8] . ltrim($“Á¡¦•, $úìıœÚ•[8]); } public function mkfile($ıªËªŸ¬, $óÓ—ã°Š = '', $ë¶‹èŒÒ = REPEAT_RENAME) { $ıªËªŸ¬ = $this->iconvSystem($ıªËªŸ¬); @touch($ıªËªŸ¬); if ($óÓ—ã°Š) { file_put_contents($ıªËªŸ¬, $óÓ—ã°Š); } @chmod($ıªËªŸ¬, $this->pathAuth); if (is_file($ıªËªŸ¬)) { return $this->getPathOuter($ıªËªŸ¬); } $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } public function mkdir($ô¢Ø¨³‹, $ƒ±ÚúË† = REPEAT_SKIP) { $ô¢Ø¨³‹ = $this->iconvSystem($ô¢Ø¨³‹); if (is_dir($ô¢Ø¨³‹)) { return $this->getPathOuter($ô¢Ø¨³‹); } @mkdir($ô¢Ø¨³‹, $this->pathAuth, !0); @chmod($ô¢Ø¨³‹, $this->pathAuth); if (is_dir($ô¢Ø¨³‹)) { return $this->getPathOuter($ô¢Ø¨³‹); } $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } public function copyFile($úõûÂË», $·òşÖ¾¹) { $this->mkdir($this->pathFather($·òşÖ¾¹)); $úõûÂË» = $this->iconvSystem($úõûÂË»); $·òşÖ¾¹ = $this->iconvSystem($·òşÖ¾¹); $µğïŸ = copy_64($úõûÂË», $·òşÖ¾¹); @chmod($·òşÖ¾¹, $this->pathAuth); if ($µğïŸ) { return $this->getPathOuter($·òşÖ¾¹); } $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } public function moveFile($±÷§ö¢Ü, $œğ†×«Æ) { $this->mkdir($this->pathFather($œğ†×«Æ)); $±÷§ö¢Ü = $this->iconvSystem($±÷§ö¢Ü); $œğ†×«Æ = $this->iconvSystem($œğ†×«Æ); $¡­şÖ ¹ = intval(@rename($±÷§ö¢Ü, $œğ†×«Æ)); if (!$¡­şÖ ¹) { if ($¡­şÖ ¹ = intval(@copy_64($±÷§ö¢Ü, $œğ†×«Æ))) { @unlink($±÷§ö¢Ü); } } @chmod($œğ†×«Æ, $this->pathAuth); if ($¡­şÖ ¹) { return $this->getPathOuter($œğ†×«Æ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } public function movePath($öˆÜ½à, $ŠíóÖ©Î, $êˆö÷ÉÚ = false) { $³ª—û § =& $_SERVER[ÆªÈ–¬]; $öˆÜ½à = $this->iconvSystem($öˆÜ½à); $ŠíóÖ©Î = $this->iconvSystem($ŠíóÖ©Î); $†ç»²¯ç = rtrim($ŠíóÖ©Î, $³ª—û §[8]) . $³ª—û §[8] . ($êˆö÷ÉÚ ? $êˆö÷ÉÚ : get_path_this($öˆÜ½à)); if (file_exists($†ç»²¯ç)) { return !1; } $¥Í•¾íÒ = intval(@rename($öˆÜ½à, $†ç»²¯ç)); $¥Í•¾íÒ = file_exists($†ç»²¯ç); if ($¥Í•¾íÒ) { return $this->getPathOuter($†ç»²¯ç); } $this->writeLog(__FUNCTION__ . $³ª—û §[1441], !0); return !1; } public function delFile($¥³ù“ú‘) { $¥³ù“ú‘ = $this->iconvSystem($¥³ù“ú‘); if (!@unlink($¥³ù“ú‘)) { @chmod($¥³ù“ú‘, $this->pathAuth); if (@unlink($¥³ù“ú‘)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } return !0; } public function delFolder($˜…‘º) { $áŞË–ÈÚ =& $_SERVER[ÆªÈ–¬]; $˜…‘º = $this->iconvSystem($˜…‘º); if (!is_dir($˜…‘º)) { return !0; } if (!($˜¼éšğš = opendir($˜…‘º))) { return !1; } while (($®ÒØÖ = readdir($˜¼éšğš)) !== !1) { if ($®ÒØÖ == $áŞË–ÈÚ[10] || $®ÒØÖ == $áŞË–ÈÚ[1356]) { continue; } $é´¼Û© = $˜…‘º . $áŞË–ÈÚ[8] . $®ÒØÖ; if (is_file($é´¼Û©) || is_link($é´¼Û©)) { if (!unlink($é´¼Û©)) { chmod($é´¼Û©, $this->pathAuth); if (!unlink($é´¼Û©)) { return !1; } } } else { if (is_dir($é´¼Û©)) { chmod($é´¼Û©, $this->pathAuth); $é´¼Û© = $this->iconvApp($é´¼Û©); if (!$this->delFolder($é´¼Û©)) { return !1; } } } } closedir($˜¼éšğš); return rmdir($˜…‘º); } public function rename($İ÷Çî¯Ø, $ˆ“÷˜ş¤) { $šË–¢éÖ =& $_SERVER[ÆªÈ–¬]; $”Ù½÷Ô€ = $this->fileNameAuto($this->pathFather($İ÷Çî¯Ø), $ˆ“÷˜ş¤); $”Ù½÷Ô€ = $this->iconvSystem($”Ù½÷Ô€); $İ÷Çî¯Ø = $this->iconvSystem($İ÷Çî¯Ø); $ª¼ñÖëÒ = $this->pathFather($İ÷Çî¯Ø); $Õï˜­öã = rtrim($ª¼ñÖëÒ, $šË–¢éÖ[8]) . $šË–¢éÖ[8] . $”Ù½÷Ô€; $èÈ·«®Ñ = @rename($İ÷Çî¯Ø, $Õï˜­öã); $Õï˜­öã = $this->iconvApp($Õï˜­öã); if ($èÈ·«®Ñ) { return $this->getPathOuter($Õï˜­öã); } $this->writeLog(__FUNCTION__ . $šË–¢éÖ[1441], !0); return !1; } public function size($àÁÁ‰ß) { $àÁÁ‰ß = $this->iconvSystem($àÁÁ‰ß); return filesize_64($àÁÁ‰ß); } public function info($Ô¶ÉïÕ) { $Ô¶ÉïÕ = $this->iconvSystem($Ô¶ÉïÕ); if ($this->isFolder($Ô¶ÉïÕ)) { return $this->folderInfo($Ô¶ÉïÕ); } else { if ($this->isFile($Ô¶ÉïÕ)) { return $this->fileInfo($Ô¶ÉïÕ); } } return !1; } protected function infoChildren($§ç·í½Í, &$ÊÚîåÑ, $ÓôõÈ´¿ = true) { $Ïåèà¾ =& $_SERVER[ÆªÈ–¬]; check_abort_echo(); $§ç·í½Í = rtrim($§ç·í½Í, $Ïåèà¾[8]) . $Ïåèà¾[8]; if ($ÓôõÈ´¿) { $§ç·í½Í = $this->iconvSystem($§ç·í½Í); } if (!($ƒ‚§Ï¿´ = @opendir($§ç·í½Í))) { return; } while (($ªÄ˜†Ñª = readdir($ƒ‚§Ï¿´)) !== !1) { if ($ªÄ˜†Ñª == $Ïåèà¾[10] || $ªÄ˜†Ñª == $Ïåèà¾[1356]) { continue; } $¨¸Íéê‹ = $§ç·í½Í . $ªÄ˜†Ñª; if (is_file($¨¸Íéê‹) || is_link($¨¸Íéê‹)) { $ÊÚîåÑ[$Ïåèà¾[80]]++; $ÊÚîåÑ[$Ïåèà¾[79]] += filesize_64($¨¸Íéê‹); } else { if (is_dir($¨¸Íéê‹)) { $ÊÚîåÑ[$Ïåèà¾[81]]++; $this->infoChildren($¨¸Íéê‹, $ÊÚîåÑ, !1); } } } closedir($ƒ‚§Ï¿´); } private function folderInfo($¸ÒıùÜ¶, $«úÉÌ›Â = false) { $‡ŞçàÔ± =& $_SERVER[ÆªÈ–¬]; $¸ÒıùÜ¶ = rtrim($¸ÒıùÜ¶, $‡ŞçàÔ±[8]) . $‡ŞçàÔ±[8]; $¢¡ ¹¾Í = $this->iconvApp($this->pathThis($¸ÒıùÜ¶)); if ($«úÉÌ›Â) { return array($‡ŞçàÔ±[32] => $¢¡ ¹¾Í, $‡ŞçàÔ±[87] => $this->getPathOuter($¸ÒıùÜ¶), $‡ŞçàÔ±[33] => $‡ŞçàÔ±[78]); } $ÓŞÉå§ã = array($‡ŞçàÔ±[32] => $¢¡ ¹¾Í, $‡ŞçàÔ±[87] => $this->getPathOuter($¸ÒıùÜ¶), $‡ŞçàÔ±[33] => $‡ŞçàÔ±[78], $‡ŞçàÔ±[231] => @filectime($¸ÒıùÜ¶), $‡ŞçàÔ±[88] => @filemtime($¸ÒıùÜ¶), $‡ŞçàÔ±[1445] => @fileatime($¸ÒıùÜ¶), $‡ŞçàÔ±[1446] => is_readable($¸ÒıùÜ¶), $‡ŞçàÔ±[1447] => is_writable($¸ÒıùÜ¶), $‡ŞçàÔ±[1448] => get_mode($¸ÒıùÜ¶)); return $ÓŞÉå§ã; } private function fileInfo($‡§ËÑÚş, $–«‘« = false) { $Ò‹ÉÒ¸± =& $_SERVER[ÆªÈ–¬]; $°ÍÕøÖî = $this->iconvApp($this->pathThis($‡§ËÑÚş)); if ($–«‘«) { return array($Ò‹ÉÒ¸±[32] => $°ÍÕøÖî, $Ò‹ÉÒ¸±[87] => $this->getPathOuter($‡§ËÑÚş), $Ò‹ÉÒ¸±[33] => $Ò‹ÉÒ¸±[230], $Ò‹ÉÒ¸±[79] => $this->size($‡§ËÑÚş), $Ò‹ÉÒ¸±[169] => $this->ext($°ÍÕøÖî)); } $Õ˜å ‘ = array($Ò‹ÉÒ¸±[32] => $°ÍÕøÖî, $Ò‹ÉÒ¸±[87] => $this->getPathOuter($‡§ËÑÚş), $Ò‹ÉÒ¸±[33] => $Ò‹ÉÒ¸±[230], $Ò‹ÉÒ¸±[231] => @filectime($‡§ËÑÚş), $Ò‹ÉÒ¸±[88] => @filemtime($‡§ËÑÚş), $Ò‹ÉÒ¸±[1445] => @fileatime($‡§ËÑÚş), $Ò‹ÉÒ¸±[79] => $this->size($‡§ËÑÚş), $Ò‹ÉÒ¸±[169] => $this->ext($°ÍÕøÖî), $Ò‹ÉÒ¸±[1446] => is_readable($‡§ËÑÚş), $Ò‹ÉÒ¸±[1447] => is_writable($‡§ËÑÚş), $Ò‹ÉÒ¸±[1448] => get_mode($‡§ËÑÚş)); return $Õ˜å ‘; } public function exist($à­È¯¦ı) { $à­È¯¦ı = $this->iconvSystem($à­È¯¦ı); return @file_exists($à­È¯¦ı); } public function isFile($¥Éö Ó£) { $¥Éö Ó£ = $this->iconvSystem($¥Éö Ó£); return @is_file($¥Éö Ó£); } public function isFolder($àŠÜ³Šä) { $àŠÜ³Šä = $this->iconvSystem($àŠÜ³Šä); return @is_dir($àŠÜ³Šä); } public function listPath($Ñ¹ÀÙÈå, $„Ã±§Ï÷ = false) { $³ıüŞ” =& $_SERVER[ÆªÈ–¬]; $Ñ¹ÀÙÈå = $this->iconvSystem($Ñ¹ÀÙÈå); $Ñ¹ÀÙÈå = rtrim($Ñ¹ÀÙÈå, $³ıüŞ”[8]) . $³ıüŞ”[8]; $Å½³£ıê = array($³ıüŞ”[85] => array(), $³ıüŞ”[86] => array()); if (!($ ¬½ÉÌø = @opendir($Ñ¹ÀÙÈå))) { return $Å½³£ıê; } while (($ú•Ï—éÓ = readdir($ ¬½ÉÌø)) !== !1) { if ($ú•Ï—éÓ == $³ıüŞ”[10] || $ú•Ï—éÓ == $³ıüŞ”[1356]) { continue; } $´¯ò…Ûû = $Ñ¹ÀÙÈå . $ú•Ï—éÓ; if (is_file($´¯ò…Ûû)) { $Å½³£ıê[$³ıüŞ”[86]][] = $this->fileInfo($´¯ò…Ûû, $„Ã±§Ï÷); } else { $Å½³£ıê[$³ıüŞ”[85]][] = $this->folderInfo($´¯ò…Ûû, $„Ã±§Ï÷); } } closedir($ ¬½ÉÌø); return $Å½³£ıê; } public function listAll($Ó¥Îƒëæ, &$Ô¹µåŞ = array()) { $™µ©Ã‡ =& $_SERVER[ÆªÈ–¬]; $Ó¥Îƒëæ = $this->iconvSystem($Ó¥Îƒëæ); $Ó¥Îƒëæ = rtrim($Ó¥Îƒëæ, $™µ©Ã‡[8]) . $™µ©Ã‡[8]; if (!($ş”ş¤² = @opendir($Ó¥Îƒëæ))) { return $Ô¹µåŞ; } while (($½¼øòÏœ = readdir($ş”ş¤²)) !== !1) { if ($½¼øòÏœ == $™µ©Ã‡[10] || $½¼øòÏœ == $™µ©Ã‡[1356]) { continue; } $ç½ÚµÛã = $Ó¥Îƒëæ . $½¼øòÏœ; $„Â¹ï¹× = is_dir($ç½ÚµÛã) && !is_link($ç½ÚµÛã) ? 1 : 0; $ç½ÚµÛã = $„Â¹ï¹× ? $ç½ÚµÛã . $™µ©Ã‡[8] : $ç½ÚµÛã; $Ô¹µåŞ[] = array($™µ©Ã‡[87] => $ç½ÚµÛã, $™µ©Ã‡[78] => $„Â¹ï¹×, $™µ©Ã‡[88] => intval(@filemtime($ç½ÚµÛã)), $™µ©Ã‡[79] => $„Â¹ï¹× ? 0 : intval($this->size($ç½ÚµÛã))); if ($„Â¹ï¹×) { $this->listAll($ç½ÚµÛã, $Ô¹µåŞ); } } closedir($ş”ş¤²); return $Ô¹µåŞ; } public function has($ä®É¹†ó, $ÊÉæÆù = false, $ˆ¬»ã¶ = true) { $«ÆğÏÀ =& $_SERVER[ÆªÈ–¬]; $ä®É¹†ó = $this->iconvSystem($ä®É¹†ó); $ä®É¹†ó = rtrim($ä®É¹†ó, $«ÆğÏÀ[8]) . $«ÆğÏÀ[8]; if (!($¶˜åù¯ = @opendir($ä®É¹†ó))) { return !1; } $‚¡ÅÍ›À = 0; $ª•‰™  = 0; $ûÜæêñ‘ = 0; while (($¶âŞù« = readdir($¶˜åù¯)) !== !1) { if ($¶âŞù« == $«ÆğÏÀ[10] || $¶âŞù« == $«ÆğÏÀ[1356]) { continue; } $üî Ö¼˜ = $ä®É¹†ó . $¶âŞù«; if ($ÊÉæÆù) { $ûÜæêñ‘++; if (@is_file($üî Ö¼˜)) { $‚¡ÅÍ›À++; } else { $ª•‰™ ++; } if ($ûÜæêñ‘ > 10000) { break; } continue; } if ($ˆ¬»ã¶) { if (@is_file($üî Ö¼˜)) { return !0; } } else { if (@is_dir($üî Ö¼˜ . $«ÆğÏÀ[8])) { return !0; } } } closedir($¶˜åù¯); if ($ÊÉæÆù) { return array($«ÆğÏÀ[239] => $‚¡ÅÍ›À, $«ÆğÏÀ[240] => $ª•‰™ ); } return !1; } public function hashSimple($÷ä›ö›â) { $¿ŠË„À¢ =& $_SERVER[ÆªÈ–¬]; if (!$÷ä›ö›â) { return md5($¿ŠË„À¢[12]); } $÷ä›ö›â = $this->iconvSystem($÷ä›ö›â); $ˆ¾¶÷î— = $this->size($÷ä›ö›â); $İ°—±êç = 200; $Î©õ‹‘¹ = 50; if ($ˆ¾¶÷î— <= $İ°—±êç * $Î©õ‹‘¹) { return $this->hashMd5($÷ä›ö›â) . $ˆ¾¶÷î—; } $¼©‰£… = $¿ŠË„À¢[12]; $ÕóŞËúË = intval($ˆ¾¶÷î— / $Î©õ‹‘¹); $¡¼š´Ø— = fopen($÷ä›ö›â, $¿ŠË„À¢[1449]); if (!$¡¼š´Ø—) { return $¼©‰£…; } for ($Öáíºàê = 0; $Öáíºàê < $Î©õ‹‘¹; $Öáíºàê++) { fseek_64($¡¼š´Ø—, $ÕóŞËúË * $Öáíºàê); $¼©‰£… .= fread($¡¼š´Ø—, $İ°—±êç); } fseek_64($¡¼š´Ø—, $ˆ¾¶÷î— - $İ°—±êç); $¼©‰£… .= fread($¡¼š´Ø—, $İ°—±êç); fclose($¡¼š´Ø—); return md5($¼©‰£…) . $ˆ¾¶÷î—; } public function getContent($òÓÃ±œ) { $òÓÃ±œ = $this->iconvSystem($òÓÃ±œ); return file_get_contents($òÓÃ±œ); } public function setContent($ıß°×, $ú‚¸¯Ä® = '') { $ıß°× = $this->iconvSystem($ıß°×); $³Ö¡Ã´‘ = @file_put_contents($ıß°×, $ú‚¸¯Ä®, LOCK_EX); if (!$³Ö¡Ã´‘) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); } clearstatcache(); @chmod($ıß°×, $this->pathAuth); return $³Ö¡Ã´‘ === !1 ? !1 : !0; } public function fileSubstr($éÀ¡¡éØ, $ñ™¤–‰‡ = 0, $è—ËÆ¥ = false) { $ë¼˜ÇÓÎ =& $_SERVER[ÆªÈ–¬]; $éÀ¡¡éØ = $this->iconvSystem($éÀ¡¡éØ); if ($è—ËÆ¥ === !1) { $è—ËÆ¥ = $this->size($éÀ¡¡éØ); } if ($è—ËÆ¥ <= 0) { return $ë¼˜ÇÓÎ[12]; } $™Ùµ¥¦– = fopen($éÀ¡¡éØ, $ë¼˜ÇÓÎ[1449]); if (!$™Ùµ¥¦–) { return !1; } fseek_64($™Ùµ¥¦–, $ñ™¤–‰‡); $ğÓš–¦ = fread($™Ùµ¥¦–, $è—ËÆ¥); fclose($™Ùµ¥¦–); if (!$ğÓš–¦) { $this->writeLog(__FUNCTION__ . $ë¼˜ÇÓÎ[1441], !0); } return $ğÓš–¦; } public function upload($‡–‹ÉÅÙ, $¦¼ìúšÓ, $³Á—í§‡ = false, $¦åıú = REPEAT_REPLACE) { if ($³Á—í§‡) { return $this->moveFile($¦¼ìúšÓ, $‡–‹ÉÅÙ); } return $this->copyFile($¦¼ìúšÓ, $‡–‹ÉÅÙ); } public function setModifyTime($£çİ‰•, $é¾Û¤ÈË = '') { @touch($£çİ‰•, intval($é¾Û¤ÈË)); } public function download($š®³÷ÌÈ, $øˆøÍÀí) { return $this->iconvSystem($š®³÷ÌÈ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¢–Ğº) { parent::__construct($¢–Ğº); $this->setSignVersion($_SERVER[ÆªÈ–¬][247]); } public function fileOutImage($şêŸâÚ, $ç¥•ˆ‹ß = 250) { $š¡İÌ„È =& $_SERVER[ÆªÈ–¬]; if ($this->size($şêŸâÚ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($şêŸâÚ, $ç¥•ˆ‹ß); } $Ò•–…±Ë = array($š¡İÌ„È[1450] => $š¡İÌ„È[1451] . $ç¥•ˆ‹ß . $š¡İÌ„È[1452]); $¿âàÙàä = $this->link($şêŸâÚ, $Ò•–…±Ë); $this->fileOutLink($¿âàÙàä); } public function fileOutLink($—äÕˆ‹) { $ÏÖÚ•ä  =& $_SERVER[ÆªÈ–¬]; if (substr($—äÕˆ‹, 0, 7) == $ÏÖÚ•ä [313]) { $—äÕˆ‹ = $ÏÖÚ•ä [314] . substr($—äÕˆ‹, 7); } header($ÏÖÚ•ä [175] . $—äÕˆ‹); die; } } goto C‹İšç¥È; E±°¯Ç¸–: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Éú‰Ğ) { parent::__construct($Éú‰Ğ); $this->setSignVersion($_SERVER[ÆªÈ–¬][247]); } public function uploadFormData($Ôø­æÌú, $õ’ş³š´ = 3600) { $ş²Î÷Ÿø =& $_SERVER[ÆªÈ–¬]; $­›¶‘ô = $ş²Î÷Ÿø[229]; $Ô–ÙÚ­Å = $ş²Î÷Ÿø[263]; $ø¥£›‹Œ = $ş²Î÷Ÿø[274]; $Ï‚ö°÷» = gmdate($ş²Î÷Ÿø[299], time() + $õ’ş³š´); $¸ÁÂÁŸè = (string) time() . $ş²Î÷Ÿø[74] . (string) (time() + $õ’ş³š´); $ô¾¢’‡• = array($ş²Î÷Ÿø[275] => $Ï‚ö°÷», $ş²Î÷Ÿø[278] => array(array($ş²Î÷Ÿø[280] => $­›¶‘ô), array($ş²Î÷Ÿø[279] => $this->bucket), array($ş²Î÷Ÿø[281], $ş²Î÷Ÿø[282], $ş²Î÷Ÿø[12]), array($ş²Î÷Ÿø[285] => $ø¥£›‹Œ), array($ş²Î÷Ÿø[1404] => $Ô–ÙÚ­Å), array($ş²Î÷Ÿø[1405] => $this->accessKey), array($ş²Î÷Ÿø[1406] => $¸ÁÂÁŸè))); $ô¾¢’‡• = json_encode($ô¾¢’‡•); $ÉÔæ¢“ = hash_hmac($ş²Î÷Ÿø[263], $¸ÁÂÁŸè, $this->secret); $ŒÂºËêå = sha1($ô¾¢’‡•); $­ãÀ’À÷ = hash_hmac($ş²Î÷Ÿø[263], $ŒÂºËêå, $ÉÔæ¢“); $±µÏ‚£ç = array($ş²Î÷Ÿø[280] => $­›¶‘ô, $ş²Î÷Ÿø[285] => $ø¥£›‹Œ, $ş²Î÷Ÿø[293] => base64_encode($ô¾¢’‡•), $ş²Î÷Ÿø[1404] => $Ô–ÙÚ­Å, $ş²Î÷Ÿø[1405] => $this->accessKey, $ş²Î÷Ÿø[1407] => $¸ÁÂÁŸè, $ş²Î÷Ÿø[1408] => $­ãÀ’À÷, $ş²Î÷Ÿø[208] => $this->getHost()); return $±µÏ‚£ç; } public function fileOutImage($ƒ£—êã’, $¥û¬È´ = 250) { $ÉØ½šÁ³ =& $_SERVER[ÆªÈ–¬]; if ($this->size($ƒ£—êã’) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ƒ£—êã’, $¥û¬È´); } $Œ®ÆÙ»ñ = $this->link($ƒ£—êã’); $Œ®ÆÙ»ñ .= $ÉØ½šÁ³[1409] . $¥û¬È´ . $ÉØ½šÁ³[1410]; $this->fileOutLink($Œ®ÆÙ»ñ); } public function fileOutLink($Ûƒ·î¨‘) { $é®¡—ºÛ =& $_SERVER[ÆªÈ–¬]; if (substr($Ûƒ·î¨‘, 0, 7) == $é®¡—ºÛ[313]) { $Ûƒ·î¨‘ = $é®¡—ºÛ[314] . substr($Ûƒ·î¨‘, 7); } header($é®¡—ºÛ[175] . $Ûƒ·î¨‘); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ô¹  ¢) { $this->pathParse = $Ô¹  ¢; $this->model = Model($_SERVER[ÆªÈ–¬][1411]); } public function getPath($Î‚Íøéü) { return trim($Î‚Íøéü, $_SERVER[ÆªÈ–¬][8]); } public function pathFather($àÕ´Â«€) { $êØ£ú¡­ = $this->parse($àÕ´Â«€); $êØ£ú¡­ = $this->infoSimple($àÕ´Â«€); return $êØ£ú¡­ ? $êØ£ú¡­[$_SERVER[ÆªÈ–¬][192]] : !1; } public function pathThis($ñ¿€‰şÌ) { $¤¦©ëïÆ = $this->infoSimple($ñ¿€‰şÌ); return $¤¦©ëïÆ ? $¤¦©ëïÆ[$_SERVER[ÆªÈ–¬][32]] : !1; } public function getPathOuter($Ôô³ÊÚ™) { if (!$Ôô³ÊÚ™) { return $Ôô³ÊÚ™; } $‰—ÄıÌ­ = $this->parse($Ôô³ÊÚ™); return KodIO::make($‰—ÄıÌ­[$_SERVER[ÆªÈ–¬][475]]); } public function copyFolderFromIO($™—ö©¹…, $íì‡ÅÎ, $Èış­Æ², $–…Ò´š×, $‹ºæ‰Å) { $œªıÔ¡ = $this->model->copyFolderFromIO($™—ö©¹…, $íì‡ÅÎ, $Èış­Æ², $–…Ò´š×, $‹ºæ‰Å); return KodIO::make($œªıÔ¡); } public function isParentOf($–ŞĞ¯èÃ, $×Á½ş„ü) { return $this->model->isParentOf($–ŞĞ¯èÃ, $×Á½ş„ü); } public function mkfile($ùŸú•“², $û÷Æ«÷ = '', $Â÷¹Ç±Û = REPEAT_RENAME) { $áı´¥Ëä =& $_SERVER[ÆªÈ–¬]; $²ÜÎìİ± = $this->parse($ùŸú•“²); $ùŸú•“² = $²ÜÎìİ±[$áı´¥Ëä[475]]; for ($èùüğãô = 0; $èùüğãô < count($²ÜÎìİ±[$áı´¥Ëä[1412]]); $èùüğãô++) { $ÄÙ€®» = $²ÜÎìİ±[$áı´¥Ëä[1412]][$èùüğãô]; if ($èùüğãô == count($²ÜÎìİ±[$áı´¥Ëä[1412]]) - 1) { $ùŸú•“² = $this->model->mkfile($ùŸú•“², $ÄÙ€®», $û÷Æ«÷, $Â÷¹Ç±Û); break; } $ùŸú•“² = $this->model->mkdir($ùŸú•“², $ÄÙ€®», REPEAT_SKIP); } return $this->getPathOuter($ùŸú•“²); } public function mkdir($İİğ¨üš, $±÷üêÅÔ = REPEAT_SKIP) { $ù‰ÜÍ¸± =& $_SERVER[ÆªÈ–¬]; $ÓšÉ©¶‚ = $this->parse($İİğ¨üš); $İİğ¨üš = $ÓšÉ©¶‚[$ù‰ÜÍ¸±[475]]; for ($ÜûÌıêš = 0; $ÜûÌıêš < count($ÓšÉ©¶‚[$ù‰ÜÍ¸±[1412]]); $ÜûÌıêš++) { $óùÉà = $ÓšÉ©¶‚[$ù‰ÜÍ¸±[1412]][$ÜûÌıêš]; $İİğ¨üš = $this->model->mkdir($İİğ¨üš, $óùÉà, $±÷üêÅÔ); } return $this->getPathOuter($İİğ¨üš); } public function copyFile($·¦°„‡Å, $Ø±ã¿²ª, $€¦Üëİ = REPEAT_REPLACE) { $ñ‹¾¡Ô¤ =& $_SERVER[ÆªÈ–¬]; $ñğéİõù = $this->parse($Ø±ã¿²ª); $êªûô”Ü = $this->model->copy($·¦°„‡Å, $ñğéİõù[$ñ‹¾¡Ô¤[475]], $€¦Üëİ, $ñğéİõù[$ñ‹¾¡Ô¤[87]]); return $êªûô”Ü ? $this->getPathOuter($êªûô”Ü) : !1; } public function moveFile($ë‚€šĞó, $Š¶ÆÅÎÃ, $ÏÂÀ‹Äø = REPEAT_REPLACE) { $Ü¸¥ù¯û =& $_SERVER[ÆªÈ–¬]; $Çî“ÏÛÌ = $this->parse($Š¶ÆÅÎÃ); $«ùÖèÈ = $this->model->move($ë‚€šĞó, $Çî“ÏÛÌ[$Ü¸¥ù¯û[475]], $ÏÂÀ‹Äø, $Çî“ÏÛÌ[$Ü¸¥ù¯û[87]]); return $«ùÖèÈ ? $this->getPathOuter($«ùÖèÈ) : !1; } public function copy($”ü¨…‚ˆ, $Ä•†â‡‡, $®¶­“Ç = REPEAT_REPLACE, $«Ìì«Ê© = false) { $ôÛß°ŠÎ = $this->parse($Ä•†â‡‡); $¨­éÒŠÆ = $this->model->copy($”ü¨…‚ˆ, $ôÛß°ŠÎ[$_SERVER[ÆªÈ–¬][475]], $®¶­“Ç, $«Ìì«Ê©); return $¨­éÒŠÆ ? $this->getPathOuter($¨­éÒŠÆ) : !1; } public function moveSameAllow() { } public function move($Ô¡§ù›, $Ì’³Ö¤, $æ«åÛ = REPEAT_REPLACE, $µ€·Å¾ = false) { $µÑ¼ê»º = $this->parse($Ì’³Ö¤); $Ç´ğÑ°é = $this->model->move($Ô¡§ù›, $µÑ¼ê»º[$_SERVER[ÆªÈ–¬][475]], $æ«åÛ, $µ€·Å¾); return $Ç´ğÑ°é ? $this->getPathOuter($Ç´ğÑ°é) : !1; } public function remove($ò¯õ¾Ç¿, $æã¯àÖæ = true) { return $this->model->remove($ò¯õ¾Ç¿, $æã¯àÖæ); } public function rename($‰¹Ìµµ, $ëí¤ªâ) { $Ô¾Û¨¡ = $this->model->rename($‰¹Ìµµ, $ëí¤ªâ); return $Ô¾Û¨¡ ? $this->getPathOuter($‰¹Ìµµ) : $Ô¾Û¨¡; } public function size($ü¢¤Ÿ¨) { $Ö³İğà¡ = $this->infoSimple($ü¢¤Ÿ¨); return $Ö³İğà¡ ? $Ö³İğà¡[$_SERVER[ÆªÈ–¬][79]] : 0; } public function infoSimple($€¤‹Òò´) { return $this->model->sourceInfo($€¤‹Òò´); } public function info($š€Àğ¦É) { return $this->infoParse($š€Àğ¦É); } public function infoAuth($ìÌï÷Š) { return $this->infoParse($ìÌï÷Š, !1, !0); } public function infoWithChildren($­›åâİì) { return $this->infoParse($­›åâİì, !0); } protected function infoParse($¦§ı¥çº, $õÛçÌ” = false, $«³êŠ“Ï = false) { if (!$õÛçÌ”) { return $this->model->pathInfo($¦§ı¥çº, $«³êŠ“Ï); } return $this->model->pathInfoMore($¦§ı¥çº); } public function infoFullSimple($íİÑëÂ) { $Õ¨°Ò“À =& $_SERVER[ÆªÈ–¬]; $¤Û”Ì¼³ = explode($Õ¨°Ò“À[8], $íİÑëÂ); $İÍÁçæ = implode($Õ¨°Ò“À[8], array_splice($¤Û”Ì¼³, 1)); return $this->model->pathInfoByPath($¤Û”Ì¼³[0], $İÍÁçæ); } public function infoFull($¿‘•ş­¬) { $ãÂÂù¶í = $this->infoFullSimple($¿‘•ş­¬); return is_array($ãÂÂù¶í) ? $this->model->pathInfo($ãÂÂù¶í[$_SERVER[ÆªÈ–¬][193]]) : !1; } public function hashSimple($ï¿°¡‰) { $œğïˆ =& $_SERVER[ÆªÈ–¬]; $€†Öı³ = $this->infoWithChildren($ï¿°¡‰); return $€†Öı³[$œğïˆ[170]][$œğïˆ[672]]; } public function hashMd5($á–á©î) { $Ø‹§ƒ =& $_SERVER[ÆªÈ–¬]; $…—©ùúˆ = $this->infoWithChildren($á–á©î); return $…—©ùúˆ[$Ø‹§ƒ[170]][$Ø‹§ƒ[547]]; } public function exist($â¡Âëà›) { $Ú© ¨Ùµ =& $_SERVER[ÆªÈ–¬]; $¡¸³°ïÙ = $this->parse($â¡Âëà›); if (!$¡¸³°ïÙ[$Ú© ¨Ùµ[87]]) { return $this->isFile($â¡Âëà›) || $this->isFolder($â¡Âëà›); } $›©òêÆÒ = array($Ú© ¨Ùµ[477] => $¡¸³°ïÙ[$Ú© ¨Ùµ[475]], $Ú© ¨Ùµ[32] => $¡¸³°ïÙ[$Ú© ¨Ùµ[87]]); $ã²·Ø– = $this->model->where($›©òêÆÒ)->find(); return $ã²·Ø– ? !0 : !1; } public function isFile($ìï¹â) { $ÅºÜ„»š =& $_SERVER[ÆªÈ–¬]; $ßÛÇ¬ØÙ = $this->infoSimple($ìï¹â); return $ßÛÇ¬ØÙ && $ßÛÇ¬ØÙ[$ÅºÜ„»š[485]] == $ÅºÜ„»š[228] ? !0 : !1; } public function isFolder($ƒ¼É¬) { $¡»ª•£ =& $_SERVER[ÆªÈ–¬]; $ª¢»„òÑ = $this->infoSimple($ƒ¼É¬); return $ª¢»„òÑ && $ª¢»„òÑ[$¡»ª•£[485]] == $¡»ª•£[91] ? !0 : !1; } public function listPath($ıïáµã†, $·ÛÓ– ’ = false) { $¨È¤ş…„ =& $_SERVER[ÆªÈ–¬]; if ($ıïáµã† == $¨È¤ş…„[12]) { return !1; } $Ù­Æ· = array($¨È¤ş…„[477] => $ıïáµã†); if ($·ÛÓ– ’) { return $this->model->listSource($Ù­Æ·, -1); } return $this->model->listSource($Ù­Æ·); } public function has($ú®¶…¨, $¯‡ »Î‚ = false, $úöéëú = null) { $Ì»Æ É =& $_SERVER[ÆªÈ–¬]; $·Ÿ¨Û¤ = $this->infoWithChildren($ú®¶…¨); if ($¯‡ »Î‚) { return array($Ì»Æ É[240] => $·Ÿ¨Û¤[$Ì»Æ É[240]], $Ì»Æ É[239] => $·Ÿ¨Û¤[$Ì»Æ É[239]]); } return $úöéëú ? $·Ÿ¨Û¤[$Ì»Æ É[240]] : $·Ÿ¨Û¤[$Ì»Æ É[239]]; } public function listAll($‚ş¨¬Æš) { $©ğ½ƒ–Î = IO::info($this->pathParse[$_SERVER[ÆªÈ–¬][87]]); if (!$©ğ½ƒ–Î) { return array(); } return $this->model->listAll($‚ş¨¬Æš); } public function getContent($Ó ‹û¦ò) { return $this->model->getContent($Ó ‹û¦ò); } public function setContent($—«©ï´, $×ÚùÅ¼æ = '') { return $this->model->setContent($—«©ï´, $×ÚùÅ¼æ); } public function fileSubstr($šÔ×Ì¬, $ä«»îŠÕ, $œ”‚™) { return $this->model->fileSubstr($šÔ×Ì¬, $ä«»îŠÕ, $œ”‚™); } public function download($†Ô±˜, $Ï¿Ğ£êĞ = '') { $Ï¤”òÓ = get_path_father($Ï¿Ğ£êĞ); $ñªŞ¸ç  = get_path_this($Ï¿Ğ£êĞ); $úÀ¸—¨Œ = $this->model->fileInfoGet($†Ô±˜); $ä·©ˆÅ¶ = IO::copy($úÀ¸—¨Œ[$_SERVER[ÆªÈ–¬][87]], $Ï¤”òÓ, !1, $ñªŞ¸ç ); return $ä·©ˆÅ¶; } public function setModifyTime($®ë½üÖ, $¤º¤ = '') { $²ºÉ®ç =& $_SERVER[ÆªÈ–¬]; if (!$®ë½üÖ) { return; } $this->model->where(array($²ºÉ®ç[491] => $®ë½üÖ))->save(array($²ºÉ®ç[88] => $¤º¤)); } public function upload($ôÑù¡£, $é¢ÈªµÌ, $Ç¨ôåÎ = false, $™…¬Ø¾ = REPEAT_REPLACE) { $èïº×ş„ =& $_SERVER[ÆªÈ–¬]; $óš”»â˜ = $this->parse($ôÑù¡£); $äØ‡•ı = $this->model->addFile($óš”»â˜[$èïº×ş„[475]], $é¢ÈªµÌ, $óš”»â˜[$èïº×ş„[87]], $Ç¨ôåÎ, $™…¬Ø¾); return $this->getPathOuter($äØ‡•ı); } public function uploadFileByID($ºúáüä, $’ØóÂª‡, $ÎÇÍä¶) { $Ï¿ßºå =& $_SERVER[ÆªÈ–¬]; $¿Îº×æŞ = $this->parse($ºúáüä); $ûµæùÖ = $this->model->addFileByFileID($¿Îº×æŞ[$Ï¿ßºå[475]], $’ØóÂª‡, $¿Îº×æŞ[$Ï¿ßºå[87]], $ÎÇÍä¶); return $this->getPathOuter($ûµæùÖ); } public function addFileByRemote($œµäÊùê, $å˜—œ, $šƒÚÓŠÇ = array(), $üñƒÄ» = '', $Ï™¹Åõ) { $Ğä­²Ìğ =& $_SERVER[ÆªÈ–¬]; $ìæÙÆûî = $this->parse($œµäÊùê); $üñƒÄ» = empty($üñƒÄ») ? $ìæÙÆûî[$Ğä­²Ìğ[87]] : $üñƒÄ»; $ŒÌ®¨¤å = $this->model->addFileByRemote($ìæÙÆûî[$Ğä­²Ìğ[475]], $å˜—œ, $üñƒÄ», $šƒÚÓŠÇ, $Ï™¹Åõ); return $this->getPathOuter($ŒÌ®¨¤å); } public function uploadLink($ûîŠ™Œü, $Ëõâ­à‡ = 0) { $¼¤´ÑÙŠ =& $_SERVER[ÆªÈ–¬]; $ÏÖƒİêÄ = $this->parse($ûîŠ™Œü); $Æğ“ŠÏá = _get($GLOBALS[$¼¤´ÑÙŠ[7]], $¼¤´ÑÙŠ[1413]); $ÈıÎŠ²Ÿ = _get($GLOBALS[$¼¤´ÑÙŠ[7]], $¼¤´ÑÙŠ[1414]); $ûîŠ™Œü = Model($¼¤´ÑÙŠ[674])->createFileName($ÏÖƒİêÄ[$¼¤´ÑÙŠ[87]], $Æğ“ŠÏá, $ÈıÎŠ²Ÿ); return IO::uploadLink($ûîŠ™Œü, $Ëõâ­à‡); } public function fileNameAuto($×úü“œó, $›ÈÃ„¯, $±äÎÍ¶ = REPEAT_REPLACE, $úŸÛ†åò = false) { return $this->model->fileNameAuto($×úü“œó, $›ÈÃ„¯, $±äÎÍ¶, $úŸÛ†åò); } public function fileNameExist($©í—ºĞ®, $ï¸°íá) { return $this->model->fileNameExist($©í—ºĞ®, $ï¸°íá); } protected function _fileOut($ÒÂà×ö±, $ãğëõ = false, $€»¥‰Äî = false, $úÃÆ‘¹· = '', $äĞÔù¼£ = false) { $ŸÒ·Ğà® =& $_SERVER[ÆªÈ–¬]; $Ó×¡‡ú = $this->model->sourceInfo($ÒÂà×ö±); if ($Ó×¡‡ú[$ŸÒ·Ğà®[485]] == $ŸÒ·Ğà®[91]) { header($ŸÒ·Ğà®[1415]); die; } $“‚øÄ‘Œ = $this->model->fileInfoGet($ÒÂà×ö±); $úÃÆ‘¹· = $“‚øÄ‘Œ[$ŸÒ·Ğà®[547]] ? $“‚øÄ‘Œ[$ŸÒ·Ğà®[547]] : $úÃÆ‘¹·; $›‡öú¡ß = isset($GLOBALS[$ŸÒ·Ğà®[182]]) && is_array($GLOBALS[$ŸÒ·Ğà®[182]]) ? $GLOBALS[$ŸÒ·Ğà®[182]][$ŸÒ·Ğà®[32]] : $Ó×¡‡ú[$ŸÒ·Ğà®[32]]; if ($äĞÔù¼£) { return IO::fileOutServer($“‚øÄ‘Œ[$ŸÒ·Ğà®[87]], $ãğëõ, $›‡öú¡ß, $úÃÆ‘¹·); } IO::fileOut($“‚øÄ‘Œ[$ŸÒ·Ğà®[87]], $ãğëõ, $›‡öú¡ß, $úÃÆ‘¹·); } public function fileOut($òŞü•‡, $¨ÙÃ¨¡± = false, $œÜ‘´ü¼ = false, $Ü÷¼¾À… = '') { $this->_fileOut($òŞü•‡, $¨ÙÃ¨¡±, $œÜ‘´ü¼, $Ü÷¼¾À…); } public function fileOutServer($óÇ¶…äÕ, $ÕÅ¨Õ²Á = false, $Öµ… = false, $ÈŠÌóôş = '') { $this->_fileOut($óÇ¶…äÕ, $ÕÅ¨Õ²Á, $Öµ…, $ÈŠÌóôş, !0); } protected function _fileOutImage($’¦İ‚…÷, $ˆ¥üä·ˆ = 250) { $œ‰»ØÔë =& $_SERVER[ÆªÈ–¬]; $»Û€ôÌª = $this->model->pathInfo($’¦İ‚…÷); if ($»Û€ôÌª[$œ‰»ØÔë[485]] == $œ‰»ØÔë[91]) { show_json($œ‰»ØÔë[1416] . $’¦İ‚…÷, !1); } $†ÃË° = $this->model->fileInfoGet($’¦İ‚…÷); $»Û€ôÌª[$œ‰»ØÔë[183]] = $†ÃË°[$œ‰»ØÔë[87]]; $GLOBALS[$œ‰»ØÔë[182]] = $»Û€ôÌª; IO::fileOutImage($†ÃË°[$œ‰»ØÔë[87]], $ˆ¥üä·ˆ); } public function fileOutImage($Øè¾š˜’, $ÊïûêÅ¿ = 250) { $this->_fileOutImage($Øè¾š˜’, $ÊïûêÅ¿); } public function fileOutImageServer($Å­‚ÓïÒ, $Û†Éö©¬ = 250) { $this->_fileOutImage($Å­‚ÓïÒ, $Û†Éö©¬); } public function link($ã²ñ€æÎ, $ÁñÑ÷—´ = '') { $±•äÜ™Ş = $this->model->fileInfoGet($ã²ñ€æÎ); return IO::link($±•äÜ™Ş[$_SERVER[ÆªÈ–¬][87]], $ÁñÑ÷—´); } protected function parse($¤Ò•¬ĞÁ) { $Ù·Ç¾¸† =& $_SERVER[ÆªÈ–¬]; if (strstr($¤Ò•¬ĞÁ, $Ù·Ç¾¸†[8]) === !1) { return array($Ù·Ç¾¸†[493] => intval($¤Ò•¬ĞÁ), $Ù·Ç¾¸†[87] => $Ù·Ç¾¸†[12], $Ù·Ç¾¸†[1412] => array()); } $ÁôË°Äœ = explode($Ù·Ç¾¸†[8], trim($¤Ò•¬ĞÁ, $Ù·Ç¾¸†[8])); if (count($ÁôË°Äœ) < 2) { show_tips(clear_html($¤Ò•¬ĞÁ) . $Ù·Ç¾¸†[1417]); } return array($Ù·Ç¾¸†[493] => intval($ÁôË°Äœ[0]), $Ù·Ç¾¸†[87] => $ÁôË°Äœ[1], $Ù·Ç¾¸†[1412] => array_slice($ÁôË°Äœ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($—Õü‡Î”) { $this->pathParse = $—Õü‡Î”; $this->model = Model($_SERVER[ÆªÈ–¬][1411]); } public function getPathOuter($© ™êÂ) { $”ÌÈï½ =& $_SERVER[ÆªÈ–¬]; if (!$© ™êÂ) { return $© ™êÂ; } $»ÑÄ¨¥ = $this->parse($© ™êÂ); return trim(KodIO::makeShare($this->pathParse[$”ÌÈï½[475]], $»ÑÄ¨¥[$”ÌÈï½[475]]), $”ÌÈï½[8]); } protected function infoParse($Ş•ËÏ, $Ñ õøÙä = false, $úŠÈÔ = false) { $šôìœŞ¦ =& $_SERVER[ÆªÈ–¬]; $îÍ¹ÙÊÇ = $this->pathParse[$šôìœŞ¦[475]]; $—àÔæ‚ã = trim($this->pathParse[$šôìœŞ¦[1243]], $šôìœŞ¦[8]); return Action($šôìœŞ¦[1418])->sharePathInfo($îÍ¹ÙÊÇ, $—àÔæ‚ã, $Ñ õøÙä); } public function infoFull($æäğà®) { $¾¿¢Òö =& $_SERVER[ÆªÈ–¬]; $½¶ßºå„ = explode($¾¿¢Òö[8], trim($æäğà®, $¾¿¢Òö[8])); if (count($½¶ßºå„) > 1) { $µÌÃ¾¦— = implode($¾¿¢Òö[8], array_splice($½¶ßºå„, 1)); $¼©Ñ¿Ç¨ = $this->model->pathInfoByPath($½¶ßºå„[0], $µÌÃ¾¦—); if (!$¼©Ñ¿Ç¨) { return !1; } $this->pathParse[$¾¿¢Òö[1243]] = $¼©Ñ¿Ç¨[$¾¿¢Òö[193]]; } return $this->infoParse($æäğà®); } public function listAll($‡ñ³É“¶) { $‹£°—€Ê =& $_SERVER[ÆªÈ–¬]; $„ë¦Æ„Ë = IO::info($this->pathParse[$‹£°—€Ê[87]]); if (!$„ë¦Æ„Ë) { return array(); } $…šÍ¾‡µ = $this->model->listAll($‡ñ³É“¶); $÷ŒŞÂŒ = Model($‹£°—€Ê[664])->getInfo($„ë¦Æ„Ë[$‹£°—€Ê[665]]); foreach ($…šÍ¾‡µ as &$¡úÂïß‰) { check_abort(); $¡úÂïß‰[$‹£°—€Ê[90]] = Action($‹£°—€Ê[1418])->_shareItemeParse($¡úÂïß‰[$‹£°—€Ê[90]], $÷ŒŞÂŒ); } unset($¡úÂïß‰); return $…šÍ¾‡µ; } } goto DŠ°ó²Ûª; f¡ÓÈ„±”’: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Áï¯‹õ•) { parent::__construct($Áï¯‹õ•); $this->setSignVersion($_SERVER[ÆªÈ–¬][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($üÙŞú†°) { parent::__construct($üÙŞú†°); $this->setSignVersion($_SERVER[ÆªÈ–¬][247]); } public function uploadFormData($´–ß£Ö¦, $‘¬Ò–ªœ = 3600) { $†¼óÙÖ¥ =& $_SERVER[ÆªÈ–¬]; $ÚÛÁş¡ = $†¼óÙÖ¥[229]; $íå—ÙÈé = $†¼óÙÖ¥[270]; $Âû£Á½ó = $†¼óÙÖ¥[62]; $ã¯¦©â÷ = gmdate($†¼óÙÖ¥[271]); $ØÔçºÜ¸ = gmdate($†¼óÙÖ¥[272]); $±¨¤Ñ÷ = $†¼óÙÖ¥[273]; $ß¡éÁ¡® = $‘¬Ò–ªœ . $†¼óÙÖ¥[12]; $ñ ¢Ö¸‘ = $†¼óÙÖ¥[274]; $ Ãü£æÉ = array($this->accessKey, $ØÔçºÜ¸, $this->region, $Âû£Á½ó, $±¨¤Ñ÷); $úÕñÙáÍ = implode($†¼óÙÖ¥[8], $ Ãü£æÉ); $È€Ë·¿… = array($†¼óÙÖ¥[275] => gmdate($†¼óÙÖ¥[299], strtotime($†¼óÙÖ¥[277])), $†¼óÙÖ¥[278] => array(array($†¼óÙÖ¥[279] => $this->bucket), array($†¼óÙÖ¥[280] => $ÚÛÁş¡), array($†¼óÙÖ¥[281], $†¼óÙÖ¥[282], $†¼óÙÖ¥[12]), array($†¼óÙÖ¥[281], $†¼óÙÖ¥[283], $†¼óÙÖ¥[12]), array($†¼óÙÖ¥[281], $†¼óÙÖ¥[284], $†¼óÙÖ¥[12]), array($†¼óÙÖ¥[285] => $ñ ¢Ö¸‘), array($†¼óÙÖ¥[286] => $úÕñÙáÍ), array($†¼óÙÖ¥[287] => $íå—ÙÈé), array($†¼óÙÖ¥[288] => $ã¯¦©â÷), array($†¼óÙÖ¥[289] => $ß¡éÁ¡®))); $”ù¤á¤± = base64_encode(json_encode($È€Ë·¿…)); $ÜŞÌº¿† = hash_hmac($†¼óÙÖ¥[290], $ØÔçºÜ¸, $†¼óÙÖ¥[291] . $this->secret, !0); $½Áæœ¹‚ = hash_hmac($†¼óÙÖ¥[290], $this->region, $ÜŞÌº¿†, !0); $«¹¤Çí» = hash_hmac($†¼óÙÖ¥[290], $Âû£Á½ó, $½Áæœ¹‚, !0); $™ø‹€® = hash_hmac($†¼óÙÖ¥[290], $±¨¤Ñ÷, $«¹¤Çí», !0); $ùŠ¹•ô = hash_hmac($†¼óÙÖ¥[290], $”ù¤á¤±, $™ø‹€®); $ÔŸşïã® = array($†¼óÙÖ¥[246] => $†¼óÙÖ¥[12], $†¼óÙÖ¥[292] => $†¼óÙÖ¥[12], $†¼óÙÖ¥[280] => $ÚÛÁş¡, $†¼óÙÖ¥[285] => $ñ ¢Ö¸‘, $†¼óÙÖ¥[293] => $”ù¤á¤±, $†¼óÙÖ¥[294] => $úÕñÙáÍ, $†¼óÙÖ¥[295] => $íå—ÙÈé, $†¼óÙÖ¥[296] => $ã¯¦©â÷, $†¼óÙÖ¥[297] => $ß¡éÁ¡®, $†¼óÙÖ¥[298] => $ùŠ¹•ô, $†¼óÙÖ¥[208] => $this->getHost()); return $ÔŸşïã®; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¦Çïâˆå) { parent::__construct(); if (count($¦Çïâˆå) > 0) { $this->_init($¦Çïâˆå); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($‘ÂĞ™ÛŞ) { $œÚæšÖš =& $_SERVER[ÆªÈ–¬]; global $config; $this->appCharset = $config[$œÚæšÖš[1429]]; $this->systemCharset = $config[$œÚæšÖš[1430]]; if (isset($‘ÂĞ™ÛŞ[$œÚæšÖš[1431]]) && $‘ÂĞ™ÛŞ[$œÚæšÖš[1431]]) { $this->systemCharset = $‘ÂĞ™ÛŞ[$œÚæšÖš[1431]]; } } public function iconvApp($ÇĞÀµ•¥) { return $this->iconvTo($ÇĞÀµ•¥, $this->systemCharset, $this->appCharset); } public function iconvSystem($õåà’) { return $this->iconvTo($õåà’, $this->appCharset, $this->systemCharset); } public function getPathOuter($ô·ÔÑŠ) { $ËåÚ¼ø =& $_SERVER[ÆªÈ–¬]; $á™“Şœ­ = $this->iconvApp($this->pathBase); $ô·ÔÑŠ = $this->iconvApp($ô·ÔÑŠ); if (substr($á™“Şœ­, 0, 2) == $ËåÚ¼ø[1403]) { $á™“Şœ­ = BASIC_PATH . substr($á™“Şœ­, 2); } if (substr($ô·ÔÑŠ, 0, 2) == $ËåÚ¼ø[1403]) { $ô·ÔÑŠ = BASIC_PATH . substr($ô·ÔÑŠ, 2); } $á™“Şœ­ = KodIO::clear($á™“Şœ­); $ô·ÔÑŠ = KodIO::clear($ô·ÔÑŠ); $ô·ÔÑŠ = substr($ô·ÔÑŠ, strlen($á™“Şœ­)); if (empty($this->pathDriver)) { return $ô·ÔÑŠ; } return $this->pathDriver . $ËåÚ¼ø[8] . ltrim($ô·ÔÑŠ, $ËåÚ¼ø[8]); } private function _init($Ûºñ–ğ = array()) { $éõÚ¼ó— =& $_SERVER[ÆªÈ–¬]; if (!function_exists($éõÚ¼ó—[1432])) { throw new Exception(LNG($éõÚ¼ó—[1433])); } $this->config = $Ûºñ–ğ; $this->charsetReset($Ûºñ–ğ); foreach ($Ûºñ–ğ as $ÏçÓüÁ˜ => $û¯º»¡) { if (isset($this->{$ÏçÓüÁ˜})) { $this->{$ÏçÓüÁ˜} = $û¯º»¡; } } return $this->_login($Ûºñ–ğ); } private function _login($÷¸ˆ‘¦Û) { $ãÅé°³¹ =& $_SERVER[ÆªÈ–¬]; static $ı€”ô¥Í = array(); $ó÷ãÕ°” = md5(json_encode($÷¸ˆ‘¦Û)); if (isset($ı€”ô¥Í[$ó÷ãÕ°”])) { foreach ($ı€”ô¥Í[$ó÷ãÕ°”] as $“Ğöçª => $™Ğ—©şæ) { $this->{$“Ğöçª} = $™Ğ—©şæ; } return !0; } $Â®²Ğı» = parse_url(trim($this->server, $ãÅé°³¹[8])); $this->host = $Â®²Ğı»[$ãÅé°³¹[208]]; $œşğ© = isset($Â®²Ğı»[$ãÅé°³¹[207]]) && $Â®²Ğı»[$ãÅé°³¹[207]] == $ãÅé°³¹[1434] ? !0 : !1; $this->scheme = $œşğ© ? $ãÅé°³¹[1435] : $ãÅé°³¹[1436]; $this->port = isset($Â®²Ğı»[$ãÅé°³¹[209]]) ? $Â®²Ğı»[$ãÅé°³¹[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ãÅé°³¹[1437]) . $this->host . $ãÅé°³¹[4] . $this->port, !0); return !1; } $´ûˆ’ú³ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$´ûˆ’ú³) { $this->writeLog(LNG($ãÅé°³¹[1438]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $®ŞŞÛ·£ = $this->pasv == $ãÅé°³¹[91] ? !0 : !1; @ftp_pasv($this->connect, $®ŞŞÛ·£); $ı€”ô¥Í[$ó÷ãÕ°”] = array($ãÅé°³¹[1439] => $this->connect, $ãÅé°³¹[208] => $this->host, $ãÅé°³¹[207] => $this->scheme, $ãÅé°³¹[209] => $this->port); return $´ûˆ’ú³; } private function _isconn($‹©¶‹»³ = true) { if (is_resource($this->connect)) { return !0; } if (!$‹©¶‹»³) { return !1; } return $this->_login($this->config); } public function mkfile($å‚ğÚ†¯, $°Ó¡¶€ˆ = '', $ºîµù² = REPEAT_RENAME) { if ($this->setContent($å‚ğÚ†¯, $°Ó¡¶€ˆ)) { return $this->getPathOuter($å‚ğÚ†¯); } $this->writeLog(LNG($_SERVER[ÆªÈ–¬][1440]), !0); return !1; } public function mkdir($›í©‡Êì, $¡áöôŠÈ = REPEAT_SKIP) { $ğ¢±é´ =& $_SERVER[ÆªÈ–¬]; if (!$›í©‡Êì || $›í©‡Êì == $ğ¢±é´[8]) { return !0; } if (!$this->_isconn()) { return !1; } $›í©‡Êì = $this->iconvSystem($›í©‡Êì); if ($this->_isFolder($›í©‡Êì) || @ftp_mkdir($this->connect, $›í©‡Êì)) { return $this->getPathOuter($›í©‡Êì); } if (!$this->mkdir($this->pathFather($›í©‡Êì))) { return !1; } if ($›í©‡Êì = @ftp_mkdir($this->connect, $›í©‡Êì)) { return $this->getPathOuter($›í©‡Êì); } $this->writeLog(__FUNCTION__ . $ğ¢±é´[1441], !0); return !1; } public function copyFile($´ä•œ¶ƒ, $â¶±Ó¬—) { if (!$this->_isconn()) { return !1; } $íß³Ä“é = $this->pathThis($this->iconvSystem($´ä•œ¶ƒ)); $‰€ÃşË = $this->tempFile($íß³Ä“é); $Õ§Ãª¶¬ = $this->iconvApp($‰€ÃşË); $this->download($´ä•œ¶ƒ, $Õ§Ãª¶¬); $Ï­½×‘² = $this->upload($â¶±Ó¬—, $Õ§Ãª¶¬); $this->tempFileRemve($‰€ÃşË); return $Ï­½×‘²; } public function moveFile($‡ëÓçõ±, $İ¡ã—‘ô) { if (!$this->_isconn()) { return !1; } $‡ëÓçõ± = $this->iconvSystem($‡ëÓçõ±); $İ¡ã—‘ô = $this->iconvSystem($İ¡ã—‘ô); $ç£–¢ÑÎ = @ftp_rename($this->connect, $‡ëÓçõ±, $İ¡ã—‘ô); if (!$ç£–¢ÑÎ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } return $this->getPathOuter($İ¡ã—‘ô); } public function delFile($İä©åÙè) { if (!$this->_isconn()) { return !1; } $İä©åÙè = $this->iconvSystem($İä©åÙè); $ãË™ÃÏ£ = @ftp_delete($this->connect, $İä©åÙè); if (!$ãË™ÃÏ£) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); } return $ãË™ÃÏ£; } public function delFolder($ å±ç±Ã) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ûª¥¦Ğ¤ = $¶³äİÂ = array(); $this->fileList($ å±ç±Ã, $ûª¥¦Ğ¤, $¶³äİÂ, !0); $this->listItemCache = !0; foreach ($¶³äİÂ as $ßñ¿‘ê¶) { $Ø¾ÀÛéÃ = $this->iconvSystem($ßñ¿‘ê¶[$_SERVER[ÆªÈ–¬][32]]); $ø§ÔË– = @ftp_delete($this->connect, $Ø¾ÀÛéÃ); if (!$ø§ÔË–) { return !1; } } foreach ($ûª¥¦Ğ¤ as $Ø¾ÀÛéÃ) { $Ø¾ÀÛéÃ = $this->iconvSystem($Ø¾ÀÛéÃ); $ø§ÔË– = @ftp_rmdir($this->connect, $Ø¾ÀÛéÃ); if (!$ø§ÔË–) { return !1; } } $ å±ç±Ã = $this->iconvSystem($ å±ç±Ã); return @ftp_rmdir($this->connect, $ å±ç±Ã); } public function rename($êÔ®ÈÃº, $Áğ†ÜÉ›) { $•¦Í£µ¦ =& $_SERVER[ÆªÈ–¬]; if (!$this->_isconn()) { return !1; } $™¯´¤óó = $this->fileNameAuto($this->pathFather($êÔ®ÈÃº), $Áğ†ÜÉ›); $™¯´¤óó = $this->iconvSystem($™¯´¤óó); $êÔ®ÈÃº = $this->iconvSystem($êÔ®ÈÃº); $›Í»ñ³Œ = $this->pathFather($êÔ®ÈÃº); $ƒÅ“şƒ = rtrim($›Í»ñ³Œ, $•¦Í£µ¦[8]) . $•¦Í£µ¦[8] . $™¯´¤óó; $ğ¿±ÜÕÅ = @ftp_rename($this->connect, $êÔ®ÈÃº, $ƒÅ“şƒ); if (!$ğ¿±ÜÕÅ) { $this->writeLog(__FUNCTION__ . $•¦Í£µ¦[1441], !0); return !1; } $ƒÅ“şƒ = $this->iconvApp($ƒÅ“şƒ); return $this->getPathOuter($ƒÅ“şƒ); } private function folderInfo($ü‹Û±«…, $ó¡ª€˜ = false) { $Û˜ÅÚêö =& $_SERVER[ÆªÈ–¬]; $˜µùÉ–ï = array($Û˜ÅÚêö[32] => $this->pathThis($ü‹Û±«…), $Û˜ÅÚêö[87] => $this->getPathOuter($Û˜ÅÚêö[8] . $ü‹Û±«…), $Û˜ÅÚêö[33] => $Û˜ÅÚêö[78]); if ($ó¡ª€˜) { return $˜µùÉ–ï; } $˜µùÉ–ï[$Û˜ÅÚêö[231]] = $˜µùÉ–ï[$Û˜ÅÚêö[88]] = 0; $˜µùÉ–ï[$Û˜ÅÚêö[232]] = $˜µùÉ–ï[$Û˜ÅÚêö[233]] = !0; return $˜µùÉ–ï; } private function fileInfo($Œ¢Ú°ó, $¨„˜’“ = false, $Š ™ªà = array()) { $»æäæØ =& $_SERVER[ÆªÈ–¬]; $ê‹µÁ·Ô = array($»æäæØ[32] => $this->pathThis($Œ¢Ú°ó), $»æäæØ[87] => $this->getPathOuter($»æäæØ[8] . $Œ¢Ú°ó), $»æäæØ[33] => $»æäæØ[230], $»æäæØ[79] => isset($Š ™ªà[$»æäæØ[79]]) ? $Š ™ªà[$»æäæØ[79]] : 0, $»æäæØ[169] => $this->ext($Œ¢Ú°ó)); if ($¨„˜’“) { return $ê‹µÁ·Ô; } $ê‹µÁ·Ô[$»æäæØ[231]] = $ê‹µÁ·Ô[$»æäæØ[88]] = 0; $ê‹µÁ·Ô[$»æäæØ[232]] = $ê‹µÁ·Ô[$»æäæØ[233]] = !0; $äÒ“Ú«Ô = $this->iconvSystem($Œ¢Ú°ó); $ê‹µÁ·Ô[$»æäæØ[88]] = @ftp_mdtm($this->connect, $äÒ“Ú«Ô); if (empty($Š ™ªà)) { $Š ™ªà = $this->objectMeta($Œ¢Ú°ó); if (!$Š ™ªà) { return $ê‹µÁ·Ô; } } $ê‹µÁ·Ô[$»æäæØ[79]] = $Š ™ªà[$»æäæØ[79]]; return $ê‹µÁ·Ô; } public function size($äœ…‰şÒ) { $»äïÕÄÈ = $this->objectMeta($äœ…‰şÒ); return $»äïÕÄÈ ? $»äïÕÄÈ[$_SERVER[ÆªÈ–¬][79]] : 0; } public function info($Á·ö÷¥) { if ($this->isFile($Á·ö÷¥)) { return $this->fileInfo($Á·ö÷¥, 0); } else { if ($this->isFolder($Á·ö÷¥)) { return $this->folderInfo($Á·ö÷¥); } } return !1; } private function fileList($»ì¬ó»Ë, &$Ö¾ó¨ã, &$èÍÆ§¥›, $íÃôç†ã = false) { $—à©ºù£ =& $_SERVER[ÆªÈ–¬]; $»ì¬ó»Ë = $this->iconvSystem($»ì¬ó»Ë); if (!$this->isFolder($»ì¬ó»Ë)) { return !1; } @ftp_chdir($this->connect, $—à©ºù£[8]); $»ì¬ó»Ë = rtrim($»ì¬ó»Ë, $—à©ºù£[8]) . $—à©ºù£[8]; check_abort(); $‰û¢•¼ = @ftp_rawlist($this->connect, $»ì¬ó»Ë); if (!$‰û¢•¼) { $‰û¢•¼ = array(); } $Ğ¨Ü§„® = array($—à©ºù£[10] => 1, $—à©ºù£[1356] => 1); foreach ($‰û¢•¼ as $ŒğºòáÚ) { $Œçß¸²” = $this->_listItem($ŒğºòáÚ); if ($Œçß¸²”[0] == $—à©ºù£[824]) { continue; } $ƒšŠöñ€ = $Œçß¸²”[8]; if (empty($ƒšŠöñ€) && $ƒšŠöñ€ !== $—à©ºù£[228] || isset($Ğ¨Ü§„®[$ƒšŠöñ€])) { continue; } $ƒšŠöñ€ = $this->iconvApp($»ì¬ó»Ë . ltrim($ƒšŠöñ€, $—à©ºù£[8])); $»™×Ü´í = array($—à©ºù£[32] => $ƒšŠöñ€, $—à©ºù£[33] => $—à©ºù£[230], $—à©ºù£[79] => $Œçß¸²”[4]); if (substr($ŒğºòáÚ, 0, 1) == $—à©ºù£[1442]) { $»™×Ü´í[$—à©ºù£[33]] = $—à©ºù£[78]; $»™×Ü´í[$—à©ºù£[79]] = 0; } $ÂÜ‚ïÚå = $»™×Ü´í[$—à©ºù£[33]] == $—à©ºù£[78] ? !0 : !1; $this->cacheMethodInfoSet($ƒšŠöñ€, $ÂÜ‚ïÚå, $»™×Ü´í); if ($ÂÜ‚ïÚå) { $Ö¾ó¨ã[] = $ƒšŠöñ€; if ($íÃôç†ã) { $this->fileList($ƒšŠöñ€, $Ö¾ó¨ã, $èÍÆ§¥›, $íÃôç†ã); } continue; } $èÍÆ§¥›[] = $»™×Ü´í; } $this->cacheMethodInfoSet($»ì¬ó»Ë, !0); } private function _listItem($š·¹¼º­) { if (empty($š·¹¼º­)) { return array(); } $Œ¢ıæúÅ = preg_split($_SERVER[ÆªÈ–¬][1443], $š·¹¼º­); if (count($Œ¢ıæúÅ) <= 9) { return $Œ¢ıæúÅ; } $Œ¢ıæúÅ[8] = trim(substr($š·¹¼º­, strpos($š·¹¼º­, $Œ¢ıæúÅ[7]) + strlen($Œ¢ıæúÅ[7]))); return array_splice($Œ¢ıæúÅ, 0, 9); } public function listPath($ßë£Î†, $»¤Â“÷¬ = false) { $¨ô½ËœÌ =& $_SERVER[ÆªÈ–¬]; if (!$this->_isconn()) { return !1; } $úˆ«±÷Ê = $ıˆËÄÆ = array(); $this->fileList($ßë£Î†, $úˆ«±÷Ê, $ıˆËÄÆ); foreach ($úˆ«±÷Ê as $¸¥¼şâÎ => $¹Æ¬Éä«) { $úˆ«±÷Ê[$¸¥¼şâÎ] = $this->folderInfo($¹Æ¬Éä«, $»¤Â“÷¬); } foreach ($ıˆËÄÆ as $¸¥¼şâÎ => $¹Æ¬Éä«) { $ıˆËÄÆ[$¸¥¼şâÎ] = $this->fileInfo($¹Æ¬Éä«[$¨ô½ËœÌ[32]], $»¤Â“÷¬, $¹Æ¬Éä«); } return array($¨ô½ËœÌ[85] => $úˆ«±÷Ê, $¨ô½ËœÌ[86] => $ıˆËÄÆ); } public function has($È¶ÛõŸ, $‰şãëòæ = false, $Ò‘¡ú¬± = true) { $æíˆß– =& $_SERVER[ÆªÈ–¬]; $¿À‘áÖÈ = $Ò¹Î‚£È = array(); $¨ºÁ¿ßÌ = $‰şãëòæ ? !0 : !1; $this->fileList($È¶ÛõŸ, $¿À‘áÖÈ, $Ò¹Î‚£È, $¨ºÁ¿ßÌ); if ($‰şãëòæ) { return array($æíˆß–[239] => count($Ò¹Î‚£È), $æíˆß–[240] => count($¿À‘áÖÈ)); } if ($Ò‘¡ú¬±) { if (count($Ò¹Î‚£È)) { return !0; } } else { if (count($¿À‘áÖÈ)) { return !0; } } return !1; } public function listAll($—•¡õ¼£) { $³ŸØ­ğ’ =& $_SERVER[ÆªÈ–¬]; if (!$this->_isconn()) { return !1; } $™Ÿ­Û€ = $ËÃœíò¼ = array(); $this->fileList($—•¡õ¼£, $™Ÿ­Û€, $ËÃœíò¼, !0); $«Ãåğƒ¡ = array_to_keyvalue($ËÃœíò¼, $³ŸØ­ğ’[32]); foreach ($™Ÿ­Û€ as $ä¾î†ÓÚ) { if (is_string($ä¾î†ÓÚ)) { $«Ãåğƒ¡[$ä¾î†ÓÚ] = array($³ŸØ­ğ’[79] => 0); } } return $this->listAllFiles($—•¡õ¼£, $«Ãåğƒ¡); } public function getContent($Íó¾¢•ƒ) { if (!$this->_isconn()) { return !1; } $Íó¾¢•ƒ = $this->iconvSystem($Íó¾¢•ƒ); return $this->fileSubstr($Íó¾¢•ƒ); } public function setContent($Ëµ°ñµ°, $”“Œ®ç = '') { if (!$this->_isconn()) { return !1; } $ ‡Àú†Õ = $this->pathThis($this->iconvSystem($Ëµ°ñµ°)); $ñºÚÅú = $this->tempFile($ ‡Àú†Õ); file_put_contents($ñºÚÅú, $”“Œ®ç); $ƒÛó¶¶Ü = $this->upload($Ëµ°ñµ°, $this->iconvApp($ñºÚÅú)); $this->tempFileRemve($ñºÚÅú); return $ƒÛó¶¶Ü; } public function fileSubstr($ü›£ûåæ, $ÔİŠÕûÔ = 0, $âÁ·¥“Ï = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ü›£ûåæ, $ÔİŠÕûÔ, $âÁ·¥“Ï); } private function ftpRequest($Ñµ…è, $óâ—•¬Í = 0, $¼»Šé£ƒ = false) { $Ñµ…è = $this->iconvSystem($Ñµ…è); $ñ½¬²Àñ = $this->scheme . $this->host . $_SERVER[ÆªÈ–¬][4] . $this->port; $û‚ãö = curl_init(); curl_setopt($û‚ãö, CURLOPT_URL, $ñ½¬²Àñ . $this->pathEncode($Ñµ…è)); curl_setopt($û‚ãö, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¼»Šé£ƒ) { $éØ½£ = $óâ—•¬Í + $¼»Šé£ƒ - 1; curl_setopt($û‚ãö, CURLOPT_RANGE, "{$óâ—•¬Í}\x2d{$éØ½£}"); } curl_setopt($û‚ãö, CURLOPT_RETURNTRANSFER, 1); $Ôš°ÃÇÆ = curl_exec($û‚ãö); curl_close($û‚ãö); return $Ôš°ÃÇÆ; } public function upload($åˆ‘ƒ×Á, $¸ó—ûöÍ, $·Š±õ¼è = false, $¼­¹ŠÃ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($åˆ‘ƒ×Á))) { return !1; } $åˆ‘ƒ×Á = $this->iconvSystem($åˆ‘ƒ×Á); $¸ó—ûöÍ = $this->iconvSystem($¸ó—ûöÍ); $©‡Ø‡Îç = ftp_nb_put($this->connect, $åˆ‘ƒ×Á, $¸ó—ûöÍ, FTP_BINARY); while ($©‡Ø‡Îç == FTP_MOREDATA) { $©‡Ø‡Îç = ftp_nb_continue($this->connect); } if ($©‡Ø‡Îç != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } return $this->getPathOuter($åˆ‘ƒ×Á); } public function download($À°È‚‚ş, $…¥»ğüƒ = '') { if (!$this->_isconn()) { return !1; } $‰ú÷éÒ— = $this->pathFather($…¥»ğüƒ); if (!IO::mkdir($‰ú÷éÒ—)) { return !1; } $À°È‚‚ş = $this->iconvSystem($À°È‚‚ş); $…¥»ğüƒ = $this->iconvSystem($…¥»ğüƒ); $‹×‚ì¨Œ = ftp_nb_get($this->connect, $…¥»ğüƒ, $À°È‚‚ş, FTP_BINARY); while ($‹×‚ì¨Œ == FTP_MOREDATA) { $‹×‚ì¨Œ = ftp_nb_continue($this->connect); } if ($‹×‚ì¨Œ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][1441], !0); return !1; } return $this->iconvApp($…¥»ğüƒ); } public function exist($¥Ôğõ¨Ç) { return $this->isFile($¥Ôğõ¨Ç) || $this->isFolder($¥Ôğõ¨Ç); } public function isFile($Ö‚ø±Ö²) { return !$this->isFolder($Ö‚ø±Ö²) && $this->objectMeta($Ö‚ø±Ö²); } public function isFolder($×ƒÈ„øé) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][179], $×ƒÈ„øé); } protected function objectMeta($÷çÓèÚÏ) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][181], $÷çÓèÚÏ); } protected function _objectMeta($ËĞÎ‡ÕÕ) { $–¹€Ë¯‚ =& $_SERVER[ÆªÈ–¬]; if ($ËĞÎ‡ÕÕ == $–¹€Ë¯‚[12] || $ËĞÎ‡ÕÕ == $–¹€Ë¯‚[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ËĞÎ‡ÕÕ = $this->iconvSystem($ËĞÎ‡ÕÕ); $é“”ÙÆà = array($–¹€Ë¯‚[32] => $this->iconvApp($ËĞÎ‡ÕÕ), $–¹€Ë¯‚[33] => $–¹€Ë¯‚[230], $–¹€Ë¯‚[79] => 0); @ftp_chdir($this->connect, $–¹€Ë¯‚[8]); $×ÏŸéÕ÷ = @ftp_size($this->connect, $ËĞÎ‡ÕÕ); if ($×ÏŸéÕ÷ != -1) { $é“”ÙÆà[$–¹€Ë¯‚[79]] = $×ÏŸéÕ÷; } else { $å ÜÍÔÄ = @ftp_chdir($this->connect, $ËĞÎ‡ÕÕ); if (!$å ÜÍÔÄ) { return !1; } $é“”ÙÆà[$–¹€Ë¯‚[33]] = $–¹€Ë¯‚[78]; } return $é“”ÙÆà; } protected function _isFolder($òİòªåî) { $‰æº·Òã =& $_SERVER[ÆªÈ–¬]; if ($òİòªåî == $‰æº·Òã[12] || $òİòªåî == $‰æº·Òã[8]) { return !0; } $¡é¬ÓÈ = $this->_objectMeta($òİòªåî); return isset($¡é¬ÓÈ[$‰æº·Òã[33]]) && $¡é¬ÓÈ[$‰æº·Òã[33]] == $‰æº·Òã[78] ? !0 : !1; } } goto Cåçêì˜¶İ; E£à†²„Œ©: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($°…™êƒ…) { parent::__construct($°…™êƒ…); } public function uploadFormData($Şã½Á®€, $¢Û·Î•„ = 3600) { $®ñá›… =& $_SERVER[ÆªÈ–¬]; $Ÿú°òÙü = $®ñá›…[229]; $É»æ×µ¿ = $®ñá›…[270]; $É³Ö„˜í = $®ñá›…[62]; $¹ÎÅ„ÏÓ = gmdate($®ñá›…[271]); $ø˜†ŒÆõ = gmdate($®ñá›…[272]); $çÌßìÓß = $®ñá›…[273]; $ßğü‹¨í = $¢Û·Î•„ . $®ñá›…[12]; $Ø¾†¶§¥ = $®ñá›…[274]; $ä¿ªŒË‡ = array($this->accessKey, $ø˜†ŒÆõ, $this->region, $É³Ö„˜í, $çÌßìÓß); $…ä‘Û‡ = implode($®ñá›…[8], $ä¿ªŒË‡); $¦”šø Ö = array($®ñá›…[275] => gmdate($®ñá›…[299], strtotime($®ñá›…[277])), $®ñá›…[278] => array(array($®ñá›…[279] => $this->bucket), array($®ñá›…[280] => $Ÿú°òÙü), array($®ñá›…[281], $®ñá›…[282], $®ñá›…[12]), array($®ñá›…[281], $®ñá›…[283], $®ñá›…[12]), array($®ñá›…[281], $®ñá›…[284], $®ñá›…[12]), array($®ñá›…[285] => $Ø¾†¶§¥), array($®ñá›…[286] => $…ä‘Û‡), array($®ñá›…[287] => $É»æ×µ¿), array($®ñá›…[288] => $¹ÎÅ„ÏÓ), array($®ñá›…[289] => $ßğü‹¨í))); $£æõıÜİ = base64_encode(json_encode($¦”šø Ö)); $…°­§ÖÄ = hash_hmac($®ñá›…[290], $ø˜†ŒÆõ, $®ñá›…[291] . $this->secret, !0); $ñ °­Ä = hash_hmac($®ñá›…[290], $this->region, $…°­§ÖÄ, !0); $“ÛÈ±˜Õ = hash_hmac($®ñá›…[290], $É³Ö„˜í, $ñ °­Ä, !0); $‚›œ¯Áš = hash_hmac($®ñá›…[290], $çÌßìÓß, $“ÛÈ±˜Õ, !0); $ŞŠ˜¬Üš = hash_hmac($®ñá›…[290], $£æõıÜİ, $‚›œ¯Áš); $· Ã¶‚â = array($®ñá›…[246] => $®ñá›…[12], $®ñá›…[292] => $®ñá›…[12], $®ñá›…[280] => $Ÿú°òÙü, $®ñá›…[285] => $Ø¾†¶§¥, $®ñá›…[293] => $£æõıÜİ, $®ñá›…[294] => $…ä‘Û‡, $®ñá›…[295] => $É»æ×µ¿, $®ñá›…[296] => $¹ÎÅ„ÏÓ, $®ñá›…[297] => $ßğü‹¨í, $®ñá›…[298] => $ŞŠ˜¬Üš, $®ñá›…[208] => $this->getHost()); return $· Ã¶‚â; } public function multiUploadFormData($şŠõÃÖÙ, $õ÷€Ã™ = 3600) { $ÄÃÇùºÖ =& $_SERVER[ÆªÈ–¬]; $¨ôêÔù– = gmdate($ÄÃÇùºÖ[300]); $æàÅ§ˆî = array(); $Ğà’«ªà = $this->client->getUploadId($this->bucket, $şŠõÃÖÙ, $æàÅ§ˆî); if (!$Ğà’«ªà) { return !1; } return array($ÄÃÇùºÖ[254] => $Ğà’«ªà, $ÄÃÇùºÖ[208] => $this->getHost() . $ÄÃÇùºÖ[8] . $this->pathEncode($şŠõÃÖÙ), $ÄÃÇùºÖ[255] => $¨ôêÔù–, $ÄÃÇùºÖ[97] => $şŠõÃÖÙ); } public function multiUploadAuthData($Ííãášï, $™¡áØ¶ = array()) { $¢¶à„ùè =& $_SERVER[ÆªÈ–¬]; $‘Éñ·Û = isset($™¡áØ¶[$¢¶à„ùè[169]]) ? $™¡áØ¶[$¢¶à„ùè[169]] : $¢¶à„ùè[12]; $ò™Ó”› = $™¡áØ¶[$¢¶à„ùè[97]]; unset($™¡áØ¶[$¢¶à„ùè[97]]); if (isset($™¡áØ¶[$¢¶à„ùè[256]])) { return $this->listUploadParts($ò™Ó”›, $™¡áØ¶); } $ö•Ó§á„ = array(); if (isset($™¡áØ¶[$¢¶à„ùè[301]])) { $ö•Ó§á„[$¢¶à„ùè[302]] = $™¡áØ¶[$¢¶à„ùè[301]]; } $š©³Æü = explode($¢¶à„ùè[210], $this->getHost()); $ëà²¢Ìı = array($¢¶à„ùè[303] => $š©³Æü[1], $¢¶à„ùè[304] => $¢¶à„ùè[12], $¢¶à„ùè[246] => $¢¶à„ùè[123], $¢¶à„ùè[292] => $™¡áØ¶[$¢¶à„ùè[79]]); $Ä‘§Ì¼™ = $¢¶à„ùè[259]; $üßúåª¤ = $¢¶à„ùè[8] . $this->pathEncode($ò™Ó”›) . $‘Éñ·Û; $°ê¸¡®œ = $this->client->__getSignatureV4($ö•Ó§á„, $ëà²¢Ìı, $Ä‘§Ì¼™, $üßúåª¤); if (strpos($‘Éñ·Û, $¢¶à„ùè[258]) === 0) { if (isset($ö•Ó§á„[$¢¶à„ùè[302]])) { $ÉØŸµ› = $ö•Ó§á„[$¢¶à„ùè[302]]; } else { if (isset($°ê¸¡®œ[$¢¶à„ùè[302]])) { $ÉØŸµ› = $°ê¸¡®œ[$¢¶à„ùè[302]]; } else { $ÉØŸµ› = hash($¢¶à„ùè[290], $¢¶à„ùè[12]); } } return array($¢¶à„ùè[265] => $°ê¸¡®œ[$¢¶à„ùè[265]], $¢¶à„ùè[302] => $ÉØŸµ›, $¢¶à„ùè[255] => $°ê¸¡®œ[$¢¶à„ùè[305]]); } return $°ê¸¡®œ[$¢¶à„ùè[265]]; } public function listUploadParts($õ–ùå¼¶, $§§˜¸²ú = array()) { $”¿—²é• =& $_SERVER[ÆªÈ–¬]; $ÌÙö»Øú = str_replace($”¿—²é•[266], $”¿—²é•[12], $§§˜¸²ú[$”¿—²é•[169]]); $ä„¦•ğÓ = $this->client->listParts($this->bucket, $õ–ùå¼¶, $ÌÙö»Øú); if (!$ä„¦•ğÓ) { return !1; } $™÷‡çµ = $”¿—²é•[306]; foreach ($ä„¦•ğÓ as $ƒœ‚™–ò) { $™÷‡çµ .= $”¿—²é•[307] . "\x3c\120\141\162\164\116\x75\x6d\142\145\162\x3e{$ƒœ‚™–ò[$”¿—²é•[308]]}\x3c\57\120\x61\x72\x74\116\165\155\142\x65\x72\x3e\xa" . "\x3c\x45\x54\x61\147\76{$ƒœ‚™–ò[$”¿—²é•[309]]}\x3c\x2f\105\x54\x61\147\x3e\12" . $”¿—²é•[310]; } $™÷‡çµ .= $”¿—²é•[311]; $Ö•¸ÒÑë = array(); $áÚ× û = explode($”¿—²é•[210], $this->getHost()); $Ñ¶ßÌÂ² = array($”¿—²é•[303] => $áÚ× û[1], $”¿—²é•[246] => $”¿—²é•[123], $”¿—²é•[292] => strlen($™÷‡çµ)); $øàÃ‡ÚÁ = $”¿—²é•[257]; $°×ĞŒÀÛ = $”¿—²é•[8] . $this->pathEncode($õ–ùå¼¶) . $§§˜¸²ú[$”¿—²é•[169]]; $‘èê¶Ö = $this->client->__getSignatureV4($Ö•¸ÒÑë, $Ñ¶ßÌÂ², $øàÃ‡ÚÁ, $°×ĞŒÀÛ, $™÷‡çµ); return array($”¿—²é•[265] => $‘èê¶Ö[$”¿—²é•[265]], $”¿—²é•[255] => $‘èê¶Ö[$”¿—²é•[305]], $”¿—²é•[267] => $ä„¦•ğÓ, $”¿—²é•[302] => $‘èê¶Ö[$”¿—²é•[302]]); } public function link($¸ËôõÔä, $‘íÎîÊÂ = array()) { return parent::link($¸ËôõÔä, $‘íÎîÊÂ); } public function fileOut($¶ì…Ç‚´, $Àîâú… = false, $½ÙõÀœì = false, $›ßé£ËÚ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÆªÈ–¬][312])) { return parent::fileOutServer($¶ì…Ç‚´, $Àîâú…, $½ÙõÀœì, $›ßé£ËÚ); } parent::fileOut($¶ì…Ç‚´, $Àîâú…, $½ÙõÀœì, $›ßé£ËÚ); } public function fileOutImage($­öÏº· , $”šÆ¸Ú = 250) { if (strstr($this->endpoint, $_SERVER[ÆªÈ–¬][312])) { return parent::fileOutImageServer($­öÏº· , $”šÆ¸Ú); } parent::fileOutImage($­öÏº· , $”šÆ¸Ú); } public function fileOutLink($ı¿¦ıºĞ) { $´ç­ë²í =& $_SERVER[ÆªÈ–¬]; if (substr($ı¿¦ıºĞ, 0, 7) == $´ç­ë²í[313]) { $ı¿¦ıºĞ = $´ç­ë²í[314] . substr($ı¿¦ıºĞ, 7); } header($´ç­ë²í[175] . $ı¿¦ıºĞ); die; } } define($_SERVER[ÆªÈ–¬][315], 1); define($_SERVER[ÆªÈ–¬][316], 2); goto dŞ¼‹éö; dŞ¼‹éö: define($_SERVER[ÆªÈ–¬][317], 3); define($_SERVER[ÆªÈ–¬][318], 1); define($_SERVER[ÆªÈ–¬][319], 0); goto F´‰±ï˜; fÆĞİÖï³Ó: class DbSqlite extends DbSqliteBase { public function query($ğö‰×Ù“) { $ƒµö¿ =& $_SERVER[ÆªÈ–¬]; if (!CacheLock::fileLock($ƒµö¿[13])) { return !1; } $ÇÔÄÎ£‰ = parent::query($ğö‰×Ù“); CacheLock::fileUnLock($ƒµö¿[13]); return $ÇÔÄÎ£‰; } public function execute($âçØø€ò) { $³Ûïä¿Ø =& $_SERVER[ÆªÈ–¬]; if (!CacheLock::fileLock($³Ûïä¿Ø[13])) { return !1; } $ƒÍÏ©à = parent::execute($âçØø€ò); CacheLock::fileUnLock($³Ûïä¿Ø[13]); return $ƒÍÏ©à; } } class DbSqlite3 extends DbSqlite3Base { public function query($¸İÂİƒÇ) { $Å±¥Šã =& $_SERVER[ÆªÈ–¬]; if (!CacheLock::fileLock($Å±¥Šã[13])) { return !1; } $ó•ŸÛâ = parent::query($¸İÂİƒÇ); CacheLock::fileUnLock($Å±¥Šã[13]); return $ó•ŸÛâ; } public function execute($¥Øˆâõ) { $ŸÁ¢¥¼Š =& $_SERVER[ÆªÈ–¬]; if (!CacheLock::fileLock($ŸÁ¢¥¼Š[13])) { return !1; } $„È‹°ƒÅ = parent::execute($¥Øˆâõ); CacheLock::fileUnLock($ŸÁ¢¥¼Š[13]); return $„È‹°ƒÅ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\145\161" => "\74\76", "\x67\164" => "\x3e", "\x65\147\x74" => "\76\x3d", "\x6c\164" => "\x3c", "\145\x6c\x74" => "\x3c\75", "\156\157\164\154\x69\x6b\145" => "\x4e\117\x54\40\114\111\x4b\x45", "\x6c\x69\153\145" => "\114\x49\113\105", "\151\x6e" => "\111\x4e", "\x6e\157\x74\x69\156" => "\116\x4f\x54\x20\111\x4e", "\x6e\x6f\164\x20\151\156" => "\116\117\124\40\111\116", "\x62\x65\x74\x77\x65\x65\156" => "\x42\x45\x54\x57\x45\105\116", "\x6e\157\164\x62\145\x74\x77\x65\145\x6e" => "\x4e\117\124\40\x42\x45\x54\x57\105\105\116", "\x6e\x6f\164\x20\142\x65\x74\167\x65\145\x6e" => "\116\117\x54\x20\102\x45\124\127\x45\x45\x4e"); protected $selectSql = "\123\x45\114\x45\103\x54\x25\104\x49\123\124\111\116\103\124\45\40\45\x46\111\x45\x4c\x44\x25\40\106\x52\117\x4d\x20\x25\124\x41\102\x4c\105\x25\45\x4a\x4f\x49\x4e\45\45\x57\110\x45\x52\x45\x25\45\x47\122\x4f\x55\x50\x25\45\x48\x41\126\x49\x4e\x47\45\45\117\122\104\105\122\x25\45\x4c\111\x4d\x49\124\45\40\45\125\116\x49\117\116\x25\45\x43\x4f\115\115\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $¤Ñ¹íºŒ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÆªÈ–¬][1031], $¤Ñ¹íºŒ); } public function factory($ş®ŠéôÈ = '') { $ÎÏ¼´‡¢ =& $_SERVER[ÆªÈ–¬]; $ş®ŠéôÈ = $this->parseConfig($ş®ŠéôÈ); if (empty($ş®ŠéôÈ[$ÎÏ¼´‡¢[1032]])) { think_exception(think_lang($ÎÏ¼´‡¢[1033])); } $this->dbType = ucwords(strtolower($ş®ŠéôÈ[$ÎÏ¼´‡¢[1032]])); $Æ—î×‚œ = $ÎÏ¼´‡¢[1034] . $this->dbType; if (class_exists($Æ—î×‚œ)) { $ªòšî»† = new $Æ—î×‚œ($ş®ŠéôÈ); if ($ÎÏ¼´‡¢[1035] != strtolower($ş®ŠéôÈ[$ÎÏ¼´‡¢[1032]])) { $ªòšî»†->dbType = strtoupper($this->dbType); } else { $ªòšî»†->dbType = $this->_getDsnType($ş®ŠéôÈ[$ÎÏ¼´‡¢[987]]); } } else { think_exception(think_lang($ÎÏ¼´‡¢[1036]) . $ÎÏ¼´‡¢[1037] . $Æ—î×‚œ); } return $ªòšî»†; } public function __call($„œœƒ…Õ, $ÇŸĞÆ§Ó) { if (method_exists($this, $„œœƒ…Õ)) { return call_user_func_array(array($this, $„œœƒ…Õ), $ÇŸĞÆ§Ó); } } protected function _getDsnType($ˆœÃœ‚±) { $š¾ô‚– = explode($_SERVER[ÆªÈ–¬][4], $ˆœÃœ‚±); $¾“·¸Á“ = strtoupper(trim($š¾ô‚–[0])); return $¾“·¸Á“; } private function parseConfig($ŞùÆë—ß = '') { $ùä•‰ˆ =& $_SERVER[ÆªÈ–¬]; if (!empty($ŞùÆë—ß) && is_string($ŞùÆë—ß)) { $ŞùÆë—ß = $this->parseDSN($ŞùÆë—ß); } elseif (is_array($ŞùÆë—ß)) { $ŞùÆë—ß = array_change_key_case($ŞùÆë—ß); $ŞùÆë—ß = array($ùä•‰ˆ[1032] => $ŞùÆë—ß[$ùä•‰ˆ[1038]], $ùä•‰ˆ[959] => $ŞùÆë—ß[$ùä•‰ˆ[1039]], $ùä•‰ˆ[960] => $ŞùÆë—ß[$ùä•‰ˆ[1040]], $ùä•‰ˆ[957] => $ŞùÆë—ß[$ùä•‰ˆ[1041]], $ùä•‰ˆ[958] => $ŞùÆë—ß[$ùä•‰ˆ[1042]], $ùä•‰ˆ[21] => $ŞùÆë—ß[$ùä•‰ˆ[1043]], $ùä•‰ˆ[987] => $ŞùÆë—ß[$ùä•‰ˆ[1044]], $ùä•‰ˆ[17] => isset($ŞùÆë—ß[$ùä•‰ˆ[1045]]) ? $ŞùÆë—ß[$ùä•‰ˆ[1045]] : array()); } elseif (empty($ŞùÆë—ß)) { if (think_config($ùä•‰ˆ[1046]) && $ùä•‰ˆ[1035] != strtolower(think_config($ùä•‰ˆ[1047]))) { $ŞùÆë—ß = $this->parseDSN(think_config($ùä•‰ˆ[1046])); } else { $ŞùÆë—ß = array($ùä•‰ˆ[1032] => think_config($ùä•‰ˆ[1047]), $ùä•‰ˆ[959] => think_config($ùä•‰ˆ[1048]), $ùä•‰ˆ[960] => think_config($ùä•‰ˆ[1049]), $ùä•‰ˆ[957] => think_config($ùä•‰ˆ[1050]), $ùä•‰ˆ[958] => think_config($ùä•‰ˆ[1051]), $ùä•‰ˆ[21] => think_config($ùä•‰ˆ[323]), $ùä•‰ˆ[987] => think_config($ùä•‰ˆ[1046]), $ùä•‰ˆ[17] => think_config($ùä•‰ˆ[1052])); } } return $ŞùÆë—ß; } protected function initConnect($ùÖ²ìüõ = true) { if (1 == think_config($_SERVER[ÆªÈ–¬][22])) { $this->_linkID = $this->multiConnect($ùÖ²ìüõ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ª­•—ÓÆ => $Äö÷Ãø) { $this->_linkID = $Äö÷Ãø; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ğœøÑ‹Ì = false) { $ô±ÕÒÖ =& $_SERVER[ÆªÈ–¬]; static $àíü‚œ¶ = array(); static $Îñó¥ÑÎ = -1; if (empty($àíü‚œ¶)) { foreach ($this->config as $Ã‹ŞÆ–¯ => $»âç¶Şµ) { $àíü‚œ¶[$Ã‹ŞÆ–¯] = explode($ô±ÕÒÖ[50], $»âç¶Şµ); } } if (think_config($ô±ÕÒÖ[1053])) { if ($ğœøÑ‹Ì || think_config($ô±ÕÒÖ[471]) === !0) { $¿™Ğ‰ı™ = floor(mt_rand(0, think_config($ô±ÕÒÖ[1054]) - 1)); $Îñó¥ÑÎ = $¿™Ğ‰ı™; } else { if (is_numeric(think_config($ô±ÕÒÖ[1055]))) { $¿™Ğ‰ı™ = think_config($ô±ÕÒÖ[1055]); } else { $¿™Ğ‰ı™ = floor(mt_rand(think_config($ô±ÕÒÖ[1054]), count($àíü‚œ¶[$ô±ÕÒÖ[957]]) - 1)); } } } else { $¿™Ğ‰ı™ = floor(mt_rand(0, count($àíü‚œ¶[$ô±ÕÒÖ[957]]) - 1)); $Îñó¥ÑÎ = $¿™Ğ‰ı™; } $¿™Ğ‰ı™ = $Îñó¥ÑÎ !== -1 ? $Îñó¥ÑÎ : $¿™Ğ‰ı™; $’À™¯÷ï = array($ô±ÕÒÖ[959] => isset($àíü‚œ¶[$ô±ÕÒÖ[959]][$¿™Ğ‰ı™]) ? $àíü‚œ¶[$ô±ÕÒÖ[959]][$¿™Ğ‰ı™] : $àíü‚œ¶[$ô±ÕÒÖ[959]][0], $ô±ÕÒÖ[960] => isset($àíü‚œ¶[$ô±ÕÒÖ[960]][$¿™Ğ‰ı™]) ? $àíü‚œ¶[$ô±ÕÒÖ[960]][$¿™Ğ‰ı™] : $àíü‚œ¶[$ô±ÕÒÖ[960]][0], $ô±ÕÒÖ[957] => isset($àíü‚œ¶[$ô±ÕÒÖ[957]][$¿™Ğ‰ı™]) ? $àíü‚œ¶[$ô±ÕÒÖ[957]][$¿™Ğ‰ı™] : $àíü‚œ¶[$ô±ÕÒÖ[957]][0], $ô±ÕÒÖ[958] => isset($àíü‚œ¶[$ô±ÕÒÖ[958]][$¿™Ğ‰ı™]) ? $àíü‚œ¶[$ô±ÕÒÖ[958]][$¿™Ğ‰ı™] : $àíü‚œ¶[$ô±ÕÒÖ[958]][0], $ô±ÕÒÖ[21] => isset($àíü‚œ¶[$ô±ÕÒÖ[21]][$¿™Ğ‰ı™]) ? $àíü‚œ¶[$ô±ÕÒÖ[21]][$¿™Ğ‰ı™] : $àíü‚œ¶[$ô±ÕÒÖ[21]][0], $ô±ÕÒÖ[987] => isset($àíü‚œ¶[$ô±ÕÒÖ[987]][$¿™Ğ‰ı™]) ? $àíü‚œ¶[$ô±ÕÒÖ[987]][$¿™Ğ‰ı™] : $àíü‚œ¶[$ô±ÕÒÖ[987]][0], $ô±ÕÒÖ[17] => isset($àíü‚œ¶[$ô±ÕÒÖ[17]][$¿™Ğ‰ı™]) ? $àíü‚œ¶[$ô±ÕÒÖ[17]][$¿™Ğ‰ı™] : $àíü‚œ¶[$ô±ÕÒÖ[17]][0]); return $this->connect($’À™¯÷ï, $¿™Ğ‰ı™); } public function parseDSN($‡‚¬ıßĞ) { $‘™·¢°Ñ =& $_SERVER[ÆªÈ–¬]; if (empty($‡‚¬ıßĞ)) { return !1; } $—ÕŠ—Œ× = parse_url($‡‚¬ıßĞ); if ($—ÕŠ—Œ×[$‘™·¢°Ñ[207]]) { $ı´ÎË¹å = array($‘™·¢°Ñ[1032] => $—ÕŠ—Œ×[$‘™·¢°Ñ[207]], $‘™·¢°Ñ[959] => isset($—ÕŠ—Œ×[$‘™·¢°Ñ[662]]) ? $—ÕŠ—Œ×[$‘™·¢°Ñ[662]] : $‘™·¢°Ñ[12], $‘™·¢°Ñ[960] => isset($—ÕŠ—Œ×[$‘™·¢°Ñ[1056]]) ? $—ÕŠ—Œ×[$‘™·¢°Ñ[1056]] : $‘™·¢°Ñ[12], $‘™·¢°Ñ[957] => isset($—ÕŠ—Œ×[$‘™·¢°Ñ[208]]) ? $—ÕŠ—Œ×[$‘™·¢°Ñ[208]] : $‘™·¢°Ñ[12], $‘™·¢°Ñ[958] => isset($—ÕŠ—Œ×[$‘™·¢°Ñ[209]]) ? $—ÕŠ—Œ×[$‘™·¢°Ñ[209]] : $‘™·¢°Ñ[12], $‘™·¢°Ñ[21] => isset($—ÕŠ—Œ×[$‘™·¢°Ñ[87]]) ? substr($—ÕŠ—Œ×[$‘™·¢°Ñ[87]], 1) : $‘™·¢°Ñ[12]); } else { preg_match($‘™·¢°Ñ[1057], trim($‡‚¬ıßĞ), $ÉïÃÚ‰Æ); $ı´ÎË¹å = array($‘™·¢°Ñ[1032] => $ÉïÃÚ‰Æ[1], $‘™·¢°Ñ[959] => $ÉïÃÚ‰Æ[2], $‘™·¢°Ñ[960] => $ÉïÃÚ‰Æ[3], $‘™·¢°Ñ[957] => $ÉïÃÚ‰Æ[4], $‘™·¢°Ñ[958] => $ÉïÃÚ‰Æ[5], $‘™·¢°Ñ[21] => $ÉïÃÚ‰Æ[6]); } $ı´ÎË¹å[$‘™·¢°Ñ[987]] = $‘™·¢°Ñ[12]; return $ı´ÎË¹å; } protected function debug() { $„ıñµéÄ =& $_SERVER[ÆªÈ–¬]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $„ıñµéÄ[1058]; if (think_config($„ıñµéÄ[1059])) { think_status($„ıñµéÄ[1060]); think_trace($this->queryStr . $„ıñµéÄ[1061] . think_status($„ıñµéÄ[24], $„ıñµéÄ[1060], 6) . $„ıñµéÄ[1062], $„ıñµéÄ[12], $„ıñµéÄ[1063]); } } protected function parseLock($¾Î®úà = false) { $è†ıéÊŸ =& $_SERVER[ÆªÈ–¬]; if (!$¾Î®úà) { return $è†ıéÊŸ[12]; } if ($è†ıéÊŸ[989] == $this->dbType) { return $è†ıéÊŸ[1064]; } return $è†ıéÊŸ[1065]; } protected function parseSet($Æûß ‘…) { $ıïæ‘úé =& $_SERVER[ÆªÈ–¬]; foreach ($Æûß ‘… as $åÔş¼¿ç => $¥¤Óáª¦) { if (is_array($¥¤Óáª¦) && $ıïæ‘úé[373] == $¥¤Óáª¦[0]) { $ôÆÏĞœÖ[] = $this->parseKey($åÔş¼¿ç) . $ıïæ‘úé[955] . $¥¤Óáª¦[1]; } elseif (is_scalar($¥¤Óáª¦) || is_null($¥¤Óáª¦)) { $ôÆÏĞœÖ[] = $this->parseKey($åÔş¼¿ç) . $ıïæ‘úé[955] . $this->parseValue($¥¤Óáª¦); } } return $ıïæ‘úé[1066] . implode($ıïæ‘úé[50], $ôÆÏĞœÖ); } protected function bindParam($”¦Şí‹, $¶Ù³‘¤•) { $this->bind[$_SERVER[ÆªÈ–¬][4] . $”¦Şí‹] = $¶Ù³‘¤•; } protected function parseBind($üÇñá©) { $üÇñá© = array_merge($this->bind, $üÇñá©); $this->bind = array(); return $üÇñá©; } function parseKey(&$ÜÔ’£”­, $……à–şĞ = true) { if ($……à–şĞ) { $ÜÔ’£”­ = $this->parseKeyCheck($ÜÔ’£”­); } return $ÜÔ’£”­; } function parseKeyCheck($­Ç Ä³¼) { $ôùàåÁï =& $_SERVER[ÆªÈ–¬]; $­Ç Ä³¼ = trim($­Ç Ä³¼); if (!preg_match($ôùàåÁï[1067], $­Ç Ä³¼)) { think_exception($ôùàåÁï[1068] . $­Ç Ä³¼); } return $­Ç Ä³¼; } protected function parseValue($ö³—Ë‡) { $™ûÔ»Ö =& $_SERVER[ÆªÈ–¬]; if (is_string($ö³—Ë‡)) { $ö³—Ë‡ = $™ûÔ»Ö[1028] . $this->escapeString($ö³—Ë‡) . $™ûÔ»Ö[1028]; } elseif (isset($ö³—Ë‡[0]) && is_string($ö³—Ë‡[0]) && strtolower($ö³—Ë‡[0]) == $™ûÔ»Ö[373]) { $ö³—Ë‡ = $this->escapeString($ö³—Ë‡[1]); } elseif (is_array($ö³—Ë‡)) { $ö³—Ë‡ = array_map(array($this, $™ûÔ»Ö[1029]), $ö³—Ë‡); } elseif (is_bool($ö³—Ë‡)) { $ö³—Ë‡ = $ö³—Ë‡ ? $™ûÔ»Ö[91] : $™ûÔ»Ö[228]; } elseif (is_null($ö³—Ë‡)) { $ö³—Ë‡ = $™ûÔ»Ö[106]; } return $ö³—Ë‡; } protected function parseField($İæ”…„¯) { $±¶íµŠ =& $_SERVER[ÆªÈ–¬]; if (is_string($İæ”…„¯) && strpos($İæ”…„¯, $±¶íµŠ[50])) { $İæ”…„¯ = explode($±¶íµŠ[50], $İæ”…„¯); } if (is_array($İæ”…„¯)) { $€Ú–­äÓ = array(); foreach ($İæ”…„¯ as $£ñ˜ì¹ => $á†ãõÍ˜) { if (!is_numeric($£ñ˜ì¹)) { $€Ú–­äÓ[] = $this->parseKey($£ñ˜ì¹, !1) . $±¶íµŠ[1069] . $this->parseKey($á†ãõÍ˜); } else { $€Ú–­äÓ[] = $this->parseKey($á†ãõÍ˜); } } $Ë”’Ş¼­ = implode($±¶íµŠ[50], $€Ú–­äÓ); } elseif (is_string($İæ”…„¯) && !empty($İæ”…„¯)) { $Ë”’Ş¼­ = $İæ”…„¯; } else { $Ë”’Ş¼­ = $±¶íµŠ[220]; } return $Ë”’Ş¼­; } protected function parseTable($®˜¹­ğ–) { $°–Ó§« =& $_SERVER[ÆªÈ–¬]; if (is_array($®˜¹­ğ–)) { $ç±Ò„® = array(); foreach ($®˜¹­ğ– as $¢Ù‰Äô‚ => $“å«Úû) { if (!is_numeric($¢Ù‰Äô‚)) { $ç±Ò„®[] = $this->parseKey($¢Ù‰Äô‚) . $°–Ó§«[53] . $this->parseKey($“å«Úû); } else { $ç±Ò„®[] = $this->parseKey($¢Ù‰Äô‚); } } $®˜¹­ğ– = $ç±Ò„®; } elseif (is_string($®˜¹­ğ–)) { if (strstr($®˜¹­ğ–, $°–Ó§«[53])) { return $®˜¹­ğ–; } $®˜¹­ğ– = explode($°–Ó§«[50], $®˜¹­ğ–); array_walk($®˜¹­ğ–, array($this, $°–Ó§«[977])); } return $°–Ó§«[971] . trim(implode($°–Ó§«[1070], $®˜¹­ğ–), $°–Ó§«[461]) . $°–Ó§«[971]; } protected function parseWhere($©¶ç£…¨) { $šü«õ¨º =& $_SERVER[ÆªÈ–¬]; $şøòÈ–ø = $šü«õ¨º[12]; if (is_string($©¶ç£…¨)) { $şøòÈ–ø = $©¶ç£…¨; } else { $ï—å‰«  = isset($©¶ç£…¨[$šü«õ¨º[1071]]) ? strtoupper($©¶ç£…¨[$šü«õ¨º[1071]]) : $šü«õ¨º[12]; if (in_array($ï—å‰« , array($šü«õ¨º[1072], $šü«õ¨º[1073], $šü«õ¨º[1074]))) { $ï—å‰«  = $šü«õ¨º[53] . $ï—å‰«  . $šü«õ¨º[53]; unset($©¶ç£…¨[$šü«õ¨º[1071]]); } else { $ï—å‰«  = $šü«õ¨º[1075]; } foreach ($©¶ç£…¨ as $ÛèöÂ” => $ãâèÆß‡) { $şøòÈ–ø .= $šü«õ¨º[354]; if (is_numeric($ÛèöÂ”)) { $ÛèöÂ” = $šü«õ¨º[1076]; } if (0 === strpos($ÛèöÂ”, $šü«õ¨º[11])) { $şøòÈ–ø .= $this->parseThinkWhere($ÛèöÂ”, $ãâèÆß‡); } else { if (!preg_match($šü«õ¨º[1077], trim($ÛèöÂ”))) { think_exception(think_lang($šü«õ¨º[1078]) . $šü«õ¨º[4] . $ÛèöÂ”); } $Æ–ƒêó¤ = is_array($ãâèÆß‡) && isset($ãâèÆß‡[$šü«õ¨º[1079]]); $ÛèöÂ” = trim($ÛèöÂ”); if (strpos($ÛèöÂ”, $šü«õ¨º[214])) { $¾™ÚÉà = explode($šü«õ¨º[214], $ÛèöÂ”); $çŠ´Åœ = array(); foreach ($¾™ÚÉà as $ŠÊ™·Ïú => $¨†ëÓÛ) { $‡ÚëÁÕ– = $Æ–ƒêó¤ ? $ãâèÆß‡[$ŠÊ™·Ïú] : $ãâèÆß‡; $çŠ´Åœ[] = $šü«õ¨º[337] . $this->parseWhereItem($this->parseKey($¨†ëÓÛ), $‡ÚëÁÕ–) . $šü«õ¨º[976]; } $şøòÈ–ø .= implode($šü«õ¨º[1080], $çŠ´Åœ); } elseif (strpos($ÛèöÂ”, $šü«õ¨º[360])) { $¾™ÚÉà = explode($šü«õ¨º[360], $ÛèöÂ”); $çŠ´Åœ = array(); foreach ($¾™ÚÉà as $ŠÊ™·Ïú => $¨†ëÓÛ) { $‡ÚëÁÕ– = $Æ–ƒêó¤ ? $ãâèÆß‡[$ŠÊ™·Ïú] : $ãâèÆß‡; $çŠ´Åœ[] = $šü«õ¨º[337] . $this->parseWhereItem($this->parseKey($¨†ëÓÛ), $‡ÚëÁÕ–) . $šü«õ¨º[976]; } $şøòÈ–ø .= implode($šü«õ¨º[1075], $çŠ´Åœ); } else { $şøòÈ–ø .= $this->parseWhereItem($this->parseKey($ÛèöÂ”), $ãâèÆß‡); } } $şøòÈ–ø .= $šü«õ¨º[355] . $ï—å‰« ; } $şøòÈ–ø = substr($şøòÈ–ø, 0, -strlen($ï—å‰« )); } return empty($şøòÈ–ø) ? $šü«õ¨º[12] : $šü«õ¨º[1081] . $şøòÈ–ø; } protected function parseWhereItem($­¤×‚¡¢, $´¼Æ×¦) { $şØ¤çƒ =& $_SERVER[ÆªÈ–¬]; $õóÀÍÖ‚ = $şØ¤çƒ[12]; if (is_array($´¼Æ×¦)) { if (is_string($´¼Æ×¦[0])) { $Ìåú²Õ = strtolower($´¼Æ×¦[0]); if (in_array($´¼Æ×¦[0], array($şØ¤çƒ[955], $şØ¤çƒ[1082], $şØ¤çƒ[1083], $şØ¤çƒ[1084], $şØ¤çƒ[1085], $şØ¤çƒ[1086]))) { $õóÀÍÖ‚ .= $­¤×‚¡¢ . $şØ¤çƒ[53] . $´¼Æ×¦[0] . $şØ¤çƒ[53] . $this->parseValue($´¼Æ×¦[1]); } elseif (preg_match($şØ¤çƒ[1087], $´¼Æ×¦[0])) { $õóÀÍÖ‚ .= $­¤×‚¡¢ . $şØ¤çƒ[53] . $this->exp[$Ìåú²Õ] . $şØ¤çƒ[53] . $this->parseValue($´¼Æ×¦[1]); } elseif (preg_match($şØ¤çƒ[1088], $´¼Æ×¦[0])) { if (is_array($´¼Æ×¦[1])) { $ÔËŒ“ê = isset($´¼Æ×¦[2]) ? strtoupper($´¼Æ×¦[2]) : $şØ¤çƒ[1073]; if (in_array($ÔËŒ“ê, array($şØ¤çƒ[1072], $şØ¤çƒ[1073], $şØ¤çƒ[1074]))) { $èàŞëü– = array(); foreach ($´¼Æ×¦[1] as $¦§„ìÜ‹) { $èàŞëü–[] = $­¤×‚¡¢ . $şØ¤çƒ[53] . $this->exp[$Ìåú²Õ] . $şØ¤çƒ[53] . $this->parseValue($¦§„ìÜ‹); } $õóÀÍÖ‚ .= $şØ¤çƒ[337] . implode($şØ¤çƒ[53] . $ÔËŒ“ê . $şØ¤çƒ[53], $èàŞëü–) . $şØ¤çƒ[976]; } } else { $õóÀÍÖ‚ .= $­¤×‚¡¢ . $şØ¤çƒ[53] . $this->exp[$Ìåú²Õ] . $şØ¤çƒ[53] . $this->parseValue($´¼Æ×¦[1]); } } elseif ($şØ¤çƒ[373] == $Ìåú²Õ) { $õóÀÍÖ‚ .= $şØ¤çƒ[974] . $­¤×‚¡¢ . $şØ¤çƒ[53] . $´¼Æ×¦[1] . $şØ¤çƒ[1089]; } elseif (preg_match($şØ¤çƒ[1090], $´¼Æ×¦[0])) { $õóÀÍÖ‚ .= $´¼Æ×¦[0]; } elseif (preg_match($şØ¤çƒ[1091], $´¼Æ×¦[0])) { if (isset($´¼Æ×¦[2]) && $şØ¤çƒ[373] == $´¼Æ×¦[2]) { $õóÀÍÖ‚ .= $­¤×‚¡¢ . $şØ¤çƒ[53] . $this->exp[$Ìåú²Õ] . $şØ¤çƒ[53] . $´¼Æ×¦[1]; } else { if (is_string($´¼Æ×¦[1])) { $´¼Æ×¦[1] = explode($şØ¤çƒ[50], $´¼Æ×¦[1]); } $û¼½Ñº¿ = implode($şØ¤çƒ[50], $this->parseValue($´¼Æ×¦[1])); $õóÀÍÖ‚ .= $­¤×‚¡¢ . $şØ¤çƒ[53] . $this->exp[$Ìåú²Õ] . $şØ¤çƒ[974] . $û¼½Ñº¿ . $şØ¤çƒ[976]; } } elseif (preg_match($şØ¤çƒ[1092], $´¼Æ×¦[0])) { $ÁÇùİŒ” = is_string($´¼Æ×¦[1]) ? explode($şØ¤çƒ[50], $´¼Æ×¦[1]) : $´¼Æ×¦[1]; $õóÀÍÖ‚ .= $şØ¤çƒ[974] . $­¤×‚¡¢ . $şØ¤çƒ[53] . $this->exp[$Ìåú²Õ] . $şØ¤çƒ[53] . $this->parseValue($ÁÇùİŒ”[0]) . $şØ¤çƒ[1075] . $this->parseValue($ÁÇùİŒ”[1]) . $şØ¤çƒ[355]; } else { think_exception(think_lang($şØ¤çƒ[1078]) . $şØ¤çƒ[4] . $´¼Æ×¦[0]); } } else { $…Î¸¨ÃÌ = count($´¼Æ×¦); $Ì²·¾öÎ = $şØ¤çƒ[12]; if (is_string($´¼Æ×¦[$…Î¸¨ÃÌ - 1])) { $Ì²·¾öÎ = isset($´¼Æ×¦[$…Î¸¨ÃÌ - 1]) ? strtoupper($´¼Æ×¦[$…Î¸¨ÃÌ - 1]) : $şØ¤çƒ[12]; if (in_array($Ì²·¾öÎ, array($şØ¤çƒ[1072], $şØ¤çƒ[1073], $şØ¤çƒ[1074]))) { $…Î¸¨ÃÌ = $…Î¸¨ÃÌ - 1; } } else { $Ì²·¾öÎ = $şØ¤çƒ[1072]; } for ($ãÍ¡ç›Û = 0; $ãÍ¡ç›Û < $…Î¸¨ÃÌ; $ãÍ¡ç›Û++) { $ÁÇùİŒ” = is_array($´¼Æ×¦[$ãÍ¡ç›Û]) ? $´¼Æ×¦[$ãÍ¡ç›Û][1] : $´¼Æ×¦[$ãÍ¡ç›Û]; if ($şØ¤çƒ[373] == strtolower($´¼Æ×¦[$ãÍ¡ç›Û][0])) { $õóÀÍÖ‚ .= $şØ¤çƒ[337] . $­¤×‚¡¢ . $şØ¤çƒ[53] . $ÁÇùİŒ” . $şØ¤çƒ[1089] . $Ì²·¾öÎ . $şØ¤çƒ[53]; } else { $”û™È•É = is_array($´¼Æ×¦[$ãÍ¡ç›Û]) ? $this->exp[strtolower($´¼Æ×¦[$ãÍ¡ç›Û][0])] : $şØ¤çƒ[955]; if (!$”û™È•É && is_array($´¼Æ×¦[$ãÍ¡ç›Û]) && in_array($´¼Æ×¦[$ãÍ¡ç›Û][0], array($şØ¤çƒ[955], $şØ¤çƒ[1082], $şØ¤çƒ[1083], $şØ¤çƒ[1084], $şØ¤çƒ[1085], $şØ¤çƒ[1086]))) { $”û™È•É = $´¼Æ×¦[$ãÍ¡ç›Û][0]; } $õóÀÍÖ‚ .= $şØ¤çƒ[337] . $­¤×‚¡¢ . $şØ¤çƒ[53] . $”û™È•É . $şØ¤çƒ[53] . $this->parseValue($ÁÇùİŒ”) . $şØ¤çƒ[1089] . $Ì²·¾öÎ . $şØ¤çƒ[53]; } } $õóÀÍÖ‚ = substr($õóÀÍÖ‚, 0, -4); } } else { $õóÀÍÖ‚ .= $­¤×‚¡¢ . $şØ¤çƒ[1093] . $this->parseValue($´¼Æ×¦); } return $õóÀÍÖ‚; } protected function parseThinkWhere($ãªïµâ´, $æĞ ’Œö) { $İÀÔøğÃ =& $_SERVER[ÆªÈ–¬]; $¨¦­ñÛÜ = $İÀÔøğÃ[12]; switch ($ãªïµâ´) { case $İÀÔøğÃ[428]: $¨¦­ñÛÜ = $æĞ ’Œö; break; case $İÀÔøğÃ[1076]: $¨¦­ñÛÜ = is_string($æĞ ’Œö) ? $æĞ ’Œö : substr($this->parseWhere($æĞ ’Œö), 6); break; case $İÀÔøğÃ[1094]: parse_str($æĞ ’Œö, $¦ìŠé ); if (isset($¦ìŠé [$İÀÔøğÃ[1071]])) { $¬¡Ï¯ÃÑ = $İÀÔøğÃ[53] . strtoupper($¦ìŠé [$İÀÔøğÃ[1071]]) . $İÀÔøğÃ[53]; unset($¦ìŠé [$İÀÔøğÃ[1071]]); } else { $¬¡Ï¯ÃÑ = $İÀÔøğÃ[1075]; } $óŠâáˆ° = array(); foreach ($¦ìŠé  as $›Ğ¹Ä¦ => $è¡Ÿ¶½î) { $óŠâáˆ°[] = $this->parseKey($›Ğ¹Ä¦) . $İÀÔøğÃ[1093] . $this->parseValue($è¡Ÿ¶½î); } $¨¦­ñÛÜ = implode($¬¡Ï¯ÃÑ, $óŠâáˆ°); break; } return $¨¦­ñÛÜ; } protected function parseLimit($†²”¯÷) { $Ø±ö„‰ =& $_SERVER[ÆªÈ–¬]; return !empty($†²”¯÷) ? $Ø±ö„‰[51] . $†²”¯÷ . $Ø±ö„‰[53] : $Ø±ö„‰[12]; } protected function parseJoin($ç¿ «§†) { $ÅÈÙğ”€ =& $_SERVER[ÆªÈ–¬]; $İˆÌèîŒ = $ÅÈÙğ”€[12]; if (!empty($ç¿ «§†)) { if (is_array($ç¿ «§†)) { foreach ($ç¿ «§† as $ğ‡ŒÕ¬Ö => $óì‡ÛêÕ) { if (!1 !== stripos($óì‡ÛêÕ, $ÅÈÙğ”€[1095])) { $İˆÌèîŒ .= $ÅÈÙğ”€[53] . $óì‡ÛêÕ; } else { $İˆÌèîŒ .= $ÅÈÙğ”€[1096] . $óì‡ÛêÕ; } } } else { $İˆÌèîŒ .= $ÅÈÙğ”€[1096] . $ç¿ «§†; } } $İˆÌèîŒ = preg_replace($ÅÈÙğ”€[1097], think_config($ÅÈÙğ”€[1001]) . $ÅÈÙğ”€[1098], $İˆÌèîŒ); return $İˆÌèîŒ; } protected function parseOrder($ÂÔÇëø¤) { $¸“Ô®˜ª =& $_SERVER[ÆªÈ–¬]; if (is_array($ÂÔÇëø¤)) { $ôÈáµ±× = array(); foreach ($ÂÔÇëø¤ as $³œ‹û†ğ => $øùòß¡ô) { if (is_numeric($³œ‹û†ğ)) { $ôÈáµ±×[] = $this->parseKey($øùòß¡ô); } else { $øùòß¡ô = in_array(strtoupper(trim($øùòß¡ô)), array($¸“Ô®˜ª[1099], $¸“Ô®˜ª[1100])) ? $¸“Ô®˜ª[53] . $øùòß¡ô : $¸“Ô®˜ª[12]; if (preg_match($¸“Ô®˜ª[1101], $³œ‹û†ğ)) { $ôÈáµ±×[] = $this->parseKey($³œ‹û†ğ) . $øùòß¡ô; } else { think_exception($¸“Ô®˜ª[1102] . $³œ‹û†ğ); } } } $ÂÔÇëø¤ = implode($¸“Ô®˜ª[50], $ôÈáµ±×); } return !empty($ÂÔÇëø¤) ? $¸“Ô®˜ª[1103] . $ÂÔÇëø¤ : $¸“Ô®˜ª[12]; } protected function parseGroup($‡ü•šÔğ) { $Œášë¹ê =& $_SERVER[ÆªÈ–¬]; return !empty($‡ü•šÔğ) ? $Œášë¹ê[1104] . $‡ü•šÔğ : $Œášë¹ê[12]; } protected function parseHaving($”ø½—ÓÕ) { $¦›àóş© =& $_SERVER[ÆªÈ–¬]; return !empty($”ø½—ÓÕ) ? $¦›àóş©[1105] . $”ø½—ÓÕ : $¦›àóş©[12]; } protected function parseComment($¬³æíé) { $Ğ ËğÄ =& $_SERVER[ÆªÈ–¬]; return !empty($¬³æíé) ? $Ğ ËğÄ[1106] . $¬³æíé . $Ğ ËğÄ[1107] : $Ğ ËğÄ[12]; } protected function parseDistinct($ĞÔĞ®ãï) { $‹«ıĞœ¹ =& $_SERVER[ÆªÈ–¬]; return !empty($ĞÔĞ®ãï) ? $‹«ıĞœ¹[1108] : $‹«ıĞœ¹[12]; } protected function parseUnion($‡ÇìœŠ) { $´‰³£ =& $_SERVER[ÆªÈ–¬]; if (empty($‡ÇìœŠ)) { return $´‰³£[12]; } if (isset($‡ÇìœŠ[$´‰³£[424]])) { $ú¢’¥İï = $´‰³£[1109]; unset($‡ÇìœŠ[$´‰³£[424]]); } else { $ú¢’¥İï = $´‰³£[1110]; } foreach ($‡ÇìœŠ as $Õ——Î¥) { $‡ûı¿öÑ[] = $ú¢’¥İï . (is_array($Õ——Î¥) ? $this->buildSelectSql($Õ——Î¥) : $Õ——Î¥); } return implode($´‰³£[53], $‡ûı¿öÑ); } public function insert($§Í¼´Ì´, $ª¿Ñ£² = array(), $¯üÀ÷œ = false) { $‡Ë•ÏÃœ =& $_SERVER[ÆªÈ–¬]; $±„­Ùú« = $ü÷­÷ù— = array(); $this->model = $ª¿Ñ£²[$‡Ë•ÏÃœ[358]]; foreach ($§Í¼´Ì´ as $¿êùÍÄ¾ => $­º¥–ûµ) { if (is_array($­º¥–ûµ) && $‡Ë•ÏÃœ[373] == $­º¥–ûµ[0]) { $ü÷­÷ù—[] = $this->parseKey($¿êùÍÄ¾); $±„­Ùú«[] = $­º¥–ûµ[1]; } elseif (is_scalar($­º¥–ûµ) || is_null($­º¥–ûµ)) { $ü÷­÷ù—[] = $this->parseKey($¿êùÍÄ¾); $±„­Ùú«[] = $this->parseValue($­º¥–ûµ); } } $Üµ€÷¨Š = ($¯üÀ÷œ ? $‡Ë•ÏÃœ[978] : $‡Ë•ÏÃœ[979]) . $‡Ë•ÏÃœ[980] . $this->parseTable($ª¿Ñ£²[$‡Ë•ÏÃœ[356]]) . $‡Ë•ÏÃœ[974] . implode($‡Ë•ÏÃœ[50], $ü÷­÷ù—) . $‡Ë•ÏÃœ[975] . implode($‡Ë•ÏÃœ[50], $±„­Ùú«) . $‡Ë•ÏÃœ[976]; $Üµ€÷¨Š .= $this->parseLock(isset($ª¿Ñ£²[$‡Ë•ÏÃœ[917]]) ? $ª¿Ñ£²[$‡Ë•ÏÃœ[917]] : !1); $Üµ€÷¨Š .= $this->parseComment(!empty($ª¿Ñ£²[$‡Ë•ÏÃœ[430]]) ? $ª¿Ñ£²[$‡Ë•ÏÃœ[430]] : $‡Ë•ÏÃœ[12]); return $this->execute($Üµ€÷¨Š, $this->parseBind(!empty($ª¿Ñ£²[$‡Ë•ÏÃœ[361]]) ? $ª¿Ñ£²[$‡Ë•ÏÃœ[361]] : array())); } public function selectInsert($Äê¢ÄÌÙ, $‹‹»Ÿ§, $Ô¬É = array()) { $ƒºú¢µ =& $_SERVER[ÆªÈ–¬]; $this->model = $Ô¬É[$ƒºú¢µ[358]]; if (is_string($Äê¢ÄÌÙ)) { $Äê¢ÄÌÙ = explode($ƒºú¢µ[50], $Äê¢ÄÌÙ); } array_walk($Äê¢ÄÌÙ, array($this, $ƒºú¢µ[977])); $«°éÒ’¬ = $ƒºú¢µ[1111] . $this->parseTable($‹‹»Ÿ§) . $ƒºú¢µ[974] . implode($ƒºú¢µ[50], $Äê¢ÄÌÙ) . $ƒºú¢µ[1089]; $«°éÒ’¬ .= $this->buildSelectSql($Ô¬É); return $this->execute($«°éÒ’¬, $this->parseBind(!empty($Ô¬É[$ƒºú¢µ[361]]) ? $Ô¬É[$ƒºú¢µ[361]] : array())); } public function update($Çóù’‘, $Ìİ’œò¶) { $œÍ µùÛ =& $_SERVER[ÆªÈ–¬]; $this->model = $Ìİ’œò¶[$œÍ µùÛ[358]]; $åÕİŒ˜ = $œÍ µùÛ[1112] . $this->parseTable($Ìİ’œò¶[$œÍ µùÛ[356]]) . $this->parseSet($Çóù’‘) . $this->parseWhere(!empty($Ìİ’œò¶[$œÍ µùÛ[352]]) ? $Ìİ’œò¶[$œÍ µùÛ[352]] : $œÍ µùÛ[12]) . $this->parseOrder(!empty($Ìİ’œò¶[$œÍ µùÛ[441]]) ? $Ìİ’œò¶[$œÍ µùÛ[441]] : $œÍ µùÛ[12]) . $this->parseLimit(!empty($Ìİ’œò¶[$œÍ µùÛ[368]]) ? $Ìİ’œò¶[$œÍ µùÛ[368]] : $œÍ µùÛ[12]) . $this->parseLock(isset($Ìİ’œò¶[$œÍ µùÛ[917]]) ? $Ìİ’œò¶[$œÍ µùÛ[917]] : !1) . $this->parseComment(!empty($Ìİ’œò¶[$œÍ µùÛ[430]]) ? $Ìİ’œò¶[$œÍ µùÛ[430]] : $œÍ µùÛ[12]); return $this->execute($åÕİŒ˜, $this->parseBind(!empty($Ìİ’œò¶[$œÍ µùÛ[361]]) ? $Ìİ’œò¶[$œÍ µùÛ[361]] : array())); } public function delete($««™ı = array()) { $ƒ¥±Ÿ§ù =& $_SERVER[ÆªÈ–¬]; $this->model = $««™ı[$ƒ¥±Ÿ§ù[358]]; $ó®ëêéÆ = $ƒ¥±Ÿ§ù[1113] . $this->parseTable($««™ı[$ƒ¥±Ÿ§ù[356]]) . $this->parseWhere(!empty($««™ı[$ƒ¥±Ÿ§ù[352]]) ? $««™ı[$ƒ¥±Ÿ§ù[352]] : $ƒ¥±Ÿ§ù[12]) . $this->parseOrder(!empty($««™ı[$ƒ¥±Ÿ§ù[441]]) ? $««™ı[$ƒ¥±Ÿ§ù[441]] : $ƒ¥±Ÿ§ù[12]) . $this->parseLimit(!empty($««™ı[$ƒ¥±Ÿ§ù[368]]) ? $««™ı[$ƒ¥±Ÿ§ù[368]] : $ƒ¥±Ÿ§ù[12]) . $this->parseLock(isset($««™ı[$ƒ¥±Ÿ§ù[917]]) ? $««™ı[$ƒ¥±Ÿ§ù[917]] : !1) . $this->parseComment(!empty($««™ı[$ƒ¥±Ÿ§ù[430]]) ? $««™ı[$ƒ¥±Ÿ§ù[430]] : $ƒ¥±Ÿ§ù[12]); return $this->execute($ó®ëêéÆ, $this->parseBind(!empty($««™ı[$ƒ¥±Ÿ§ù[361]]) ? $««™ı[$ƒ¥±Ÿ§ù[361]] : array())); } public function select($Æ„çŒˆß = array()) { $À×–¢áƒ =& $_SERVER[ÆªÈ–¬]; $this->model = $Æ„çŒˆß[$À×–¢áƒ[358]]; $ÆÔ‡èñ = $this->buildSelectSql($Æ„çŒˆß); $¥ÊÚŒë€ = isset($Æ„çŒˆß[$À×–¢áƒ[425]]) ? $Æ„çŒˆß[$À×–¢áƒ[425]] : !1; if ($¥ÊÚŒë€) { $ç†™Èª = is_string($¥ÊÚŒë€[$À×–¢áƒ[97]]) ? $¥ÊÚŒë€[$À×–¢áƒ[97]] : $À×–¢áƒ[1114] . md5($ÆÔ‡èñ); $É¤ĞÚË¿ = think_cache($ç†™Èª, $À×–¢áƒ[12], $¥ÊÚŒë€); if (!1 !== $É¤ĞÚË¿) { return $É¤ĞÚË¿; } } $É©Ï ë = $this->query($ÆÔ‡èñ, $this->parseBind(!empty($Æ„çŒˆß[$À×–¢áƒ[361]]) ? $Æ„çŒˆß[$À×–¢áƒ[361]] : array())); if ($¥ÊÚŒë€ && !1 !== $É©Ï ë) { think_cache($ç†™Èª, $É©Ï ë, $¥ÊÚŒë€); } return $É©Ï ë; } public function buildSelectSql($çŸˆİ¤é = array()) { $øïä•¼Ú =& $_SERVER[ÆªÈ–¬]; if (isset($çŸˆİ¤é[$øïä•¼Ú[429]])) { if (strpos($çŸˆİ¤é[$øïä•¼Ú[429]], $øïä•¼Ú[50])) { list($ç”™äƒ÷, $Õï±é¬÷) = explode($øïä•¼Ú[50], $çŸˆİ¤é[$øïä•¼Ú[429]]); } else { $ç”™äƒ÷ = $çŸˆİ¤é[$øïä•¼Ú[429]]; } $ç”™äƒ÷ = $ç”™äƒ÷ ? $ç”™äƒ÷ : 1; $Õï±é¬÷ = isset($Õï±é¬÷) ? $Õï±é¬÷ : (is_numeric($çŸˆİ¤é[$øïä•¼Ú[368]]) ? $çŸˆİ¤é[$øïä•¼Ú[368]] : 20); $”˜ŒøĞÉ = $Õï±é¬÷ * ((int) $ç”™äƒ÷ - 1); $çŸˆİ¤é[$øïä•¼Ú[368]] = $”˜ŒøĞÉ . $øïä•¼Ú[50] . $Õï±é¬÷; } if (think_config($øïä•¼Ú[1115])) { $†äîÁË¥ = $øïä•¼Ú[1116] . md5(serialize($çŸˆİ¤é)); $”ÖúÔÇ = think_cache($†äîÁË¥); if ($”ÖúÔÇ) { return $”ÖúÔÇ; } } $ã›¸Ò¼œ = $this->parseSql($this->selectSql, $çŸˆİ¤é); $ã›¸Ò¼œ .= $this->parseLock(isset($çŸˆİ¤é[$øïä•¼Ú[917]]) ? $çŸˆİ¤é[$øïä•¼Ú[917]] : !1); if (isset($†äîÁË¥)) { think_cache($†äîÁË¥, $ã›¸Ò¼œ); } return $ã›¸Ò¼œ; } public function parseSql($²àÌ©Ğ, $Ô‚Ş³˜ = array()) { $üşœÏÈÔ =& $_SERVER[ÆªÈ–¬]; $²àÌ©Ğ = str_replace(array($üşœÏÈÔ[1117], $üşœÏÈÔ[1118], $üşœÏÈÔ[1119], $üşœÏÈÔ[1120], $üşœÏÈÔ[1121], $üşœÏÈÔ[1122], $üşœÏÈÔ[1123], $üşœÏÈÔ[1124], $üşœÏÈÔ[1125], $üşœÏÈÔ[1126], $üşœÏÈÔ[1127]), array($this->parseTable("{$Ô‚Ş³˜[$üşœÏÈÔ[356]]}"), $this->parseDistinct(isset($Ô‚Ş³˜[$üşœÏÈÔ[1128]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[1128]] : !1), $this->parseField(!empty($Ô‚Ş³˜[$üşœÏÈÔ[350]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[350]] : $üşœÏÈÔ[220]), $this->parseJoin(!empty($Ô‚Ş³˜[$üşœÏÈÔ[359]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[359]] : $üşœÏÈÔ[12]), $this->parseWhere(!empty($Ô‚Ş³˜[$üşœÏÈÔ[352]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[352]] : $üşœÏÈÔ[12]), $this->parseGroup(!empty($Ô‚Ş³˜[$üşœÏÈÔ[578]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[578]] : $üşœÏÈÔ[12]), $this->parseHaving(!empty($Ô‚Ş³˜[$üşœÏÈÔ[1129]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[1129]] : $üşœÏÈÔ[12]), $this->parseOrder(!empty($Ô‚Ş³˜[$üşœÏÈÔ[441]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[441]] : $üşœÏÈÔ[12]), $this->parseLimit(!empty($Ô‚Ş³˜[$üşœÏÈÔ[368]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[368]] : $üşœÏÈÔ[12]), $this->parseUnion(!empty($Ô‚Ş³˜[$üşœÏÈÔ[423]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[423]] : $üşœÏÈÔ[12]), $this->parseComment(!empty($Ô‚Ş³˜[$üşœÏÈÔ[430]]) ? $Ô‚Ş³˜[$üşœÏÈÔ[430]] : $üşœÏÈÔ[12])), $²àÌ©Ğ); return $²àÌ©Ğ; } public function getLastSql($ÁØÍúå¡ = '') { return $ÁØÍúå¡ ? $this->modelSql[$ÁØÍúå¡] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ÃÔÆŒ) { return addslashes($ÃÔÆŒ); } public function setModel($§æî´Ç±) { $this->model = $§æî´Ç±; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto FÔàÏù²‚ä; FÔàÏù²‚ä: class DbManage { function __construct($ñÑÔÓØÄ = array()) { $¹Êö« =& $_SERVER[ÆªÈ–¬]; if (empty($ñÑÔÓØÄ)) { $ñÑÔÓØÄ = $GLOBALS[$¹Êö«[6]][$¹Êö«[21]]; } $this->database = $ñÑÔÓØÄ; } public function model($Çìà„“¾ = '') { return new ModelBase($Çìà„“¾, $_SERVER[ÆªÈ–¬][12], $this->database); } public function db($¦ûÇÂŞÃ = false) { $˜ñöÕåÚ =& $_SERVER[ÆªÈ–¬]; $äÌšƒÎ‰ = array_change_key_case($this->database); if ($this->dbType() == $˜ñöÕåÚ[13] || !$¦ûÇÂŞÃ) { return $this->model()->db(); } $“Óí·™ç = $äÌšƒÎ‰[$˜ñöÕåÚ[1043]]; $äÌšƒÎ‰[$˜ñöÕåÚ[1043]] = $˜ñöÕåÚ[12]; if ($äÌšƒÎ‰[$˜ñöÕåÚ[1038]] == $˜ñöÕåÚ[1035]) { $êõã…ğî = $äÌšƒÎ‰[$˜ñöÕåÚ[1044]]; $äÌšƒÎ‰[$˜ñöÕåÚ[1044]] = substr($êõã…ğî, 0, strrpos($êõã…ğî, $˜ñöÕåÚ[1130])); } $this->database = $äÌšƒÎ‰; $şş÷˜Ã = $this->model()->db(); try { $˜¢Ê–› = $şş÷˜Ã->execute("\163\150\x6f\167\x20\x64\x61\164\141\x62\141\x73\145\163\40\154\151\x6b\x65\x20\47{$“Óí·™ç}\x27"); } catch (Exception $’âÍîÀë) { } if (!$˜¢Ê–›) { $şş÷˜Ã->execute("\143\x72\145\141\x74\x65\40\144\x61\164\141\x62\x61\x73\145\x20\x60{$“Óí·™ç}\x60"); } $äÌšƒÎ‰[$˜ñöÕåÚ[1043]] = $“Óí·™ç; if ($äÌšƒÎ‰[$˜ñöÕåÚ[1038]] == $˜ñöÕåÚ[1035]) { $äÌšƒÎ‰[$˜ñöÕåÚ[1044]] .= $˜ñöÕåÚ[1130] . $“Óí·™ç; } $this->database = $äÌšƒÎ‰; $şş÷˜Ã->execute("\x75\x73\x65\x20\x60{$“Óí·™ç}\x60"); return $şş÷˜Ã; } public function createTable($õŞ€í¡–, &$¼ê˜«ˆ) { $ëõÂûïÇ =& $_SERVER[ÆªÈ–¬]; if (!IO::exist($õŞ€í¡–)) { ActionCall($ëõÂûïÇ[1131], !0, 0); show_json(LNG($ëõÂûïÇ[1132]), !1); } $£ñšËÌß = $this->model()->db(); $–˜Ì’× = sqlSplit(IO::getContent($õŞ€í¡–)); foreach ($–˜Ì’× as $¸õ‹öìá) { $•ÆŞ—ñÄ = stripos($¸õ‹öìá, $ëõÂûïÇ[1133]) === 0; if ($•ÆŞ—ñÄ) { $¼ê˜«ˆ->task[$ëõÂûïÇ[1134]] += 1; } $£ñšËÌß->execute($¸õ‹öìá); if ($•ÆŞ—ñÄ) { preg_match($ëõÂûïÇ[1135], $¸õ‹öìá, $…ÉäÀ‹); $¼ê˜«ˆ->task[$ëõÂûïÇ[1136]] = $…ÉäÀ‹[1]; $¼ê˜«ˆ->update(1); } } } public function insertTable($Å£´¬øá, &$¹¬”¸ŞŸ) { $ áåª– =& $_SERVER[ÆªÈ–¬]; $ùğÄÍ¥® = $this->model()->db(); $óÈ–Œ¾ˆ = $ï°Ì¸Ä ? array($ï°Ì¸Ä) : $ùğÄÍ¥®->getTables(); foreach ($Å£´¬øá as $¸ÅË¨Âğ) { $ï°Ì¸Ä = basename($¸ÅË¨Âğ, $ áåª–[854]); if (!in_array($ï°Ì¸Ä, $óÈ–Œ¾ˆ)) { continue; } $¹¬”¸ŞŸ->task[$ áåª–[1136]] = $ï°Ì¸Ä; if (get_filesize($¸ÅË¨Âğ) == 0) { continue; } $íü—éâ… = $this->sqlToDb($¸ÅË¨Âğ, $¹¬”¸ŞŸ); if (!$íü—éâ…) { ActionCall($ áåª–[1131], !0, 0); show_json(LNG($ áåª–[1137]) . "\133{$ï°Ì¸Ä}\x5d", !1); } } } public function sqlFromDb($ıÊ³¨ü¿, $ƒ°¶„±Õ, &$©¡ñ«Ëõ, $£Š­¥¨ = '') { if ($©¡ñ«Ëõ) { $©¡ñ«Ëõ->task[$_SERVER[ÆªÈ–¬][1136]] = $ıÊ³¨ü¿; } $ôšä’ŞÁ = $this->model($ıÊ³¨ü¿); $Öğ®ÜõÕ = 0; $õã¥µ¾ = 0; $ÍßÖÅÓ = 10000; $—£À¢Ñı = fopen($ƒ°¶„±Õ, $_SERVER[ÆªÈ–¬][1138]); $¨ëÃĞÆÒ = $ôšä’ŞÁ->getPk(); $Ä“òêóæ = $ôšä’ŞÁ->getDbFields(); $³Œ³àĞë = $_SERVER[ÆªÈ–¬][12]; if ($GLOBALS[$_SERVER[ÆªÈ–¬][853]] && in_array($ıÊ³¨ü¿, array($_SERVER[ÆªÈ–¬][1139], $_SERVER[ÆªÈ–¬][1140]))) { $³Œ³àĞë = $ıÊ³¨ü¿; } do { $ÌÌ¢áÒÅ = array($¨ëÃĞÆÒ => array($_SERVER[ÆªÈ–¬][1085], $õã¥µ¾)); $£“Àà˜ = $ôšä’ŞÁ->where($ÌÌ¢áÒÅ)->field($Ä“òêóæ)->order($¨ëÃĞÆÒ . $_SERVER[ÆªÈ–¬][1141])->limit($ÍßÖÅÓ)->select(); $£“Àà˜ = !empty($£“Àà˜) ? $£“Àà˜ : array(); if (!($æ°­’ÙÍ = count($£“Àà˜))) { break; } $ø‰öÊØÔ = end($£“Àà˜); $õã¥µ¾ = $ø‰öÊØÔ[$¨ëÃĞÆÒ]; $»›Ú¢¦Ÿ = array(); foreach ($£“Àà˜ as $«Õ«×Ãğ) { if ($³Œ³àĞë) { if ($ıÊ³¨ü¿ == $_SERVER[ÆªÈ–¬][1139]) { if ($«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][33]] == $_SERVER[ÆªÈ–¬][1142]) { $ÄÓîÁĞ¶ = json_decode($«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][450]], !0); if ($ÄÓîÁĞ¶[$_SERVER[ÆªÈ–¬][32]] == $GLOBALS[$_SERVER[ÆªÈ–¬][853]] && $ÄÓîÁĞ¶[$_SERVER[ÆªÈ–¬][816]] != 1) { continue; } } } else { if ($«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][33]] == $_SERVER[ÆªÈ–¬][1143] && $«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][97]] == $_SERVER[ÆªÈ–¬][848]) { continue; } } } if ($£Š­¥¨) { $«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][87]] = "\x7b\151\157\x3a{$£Š­¥¨}\x7d" . substr($«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][87]], strlen("\173\151\157\72{$«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][883]]}\175")); $«Õ«×Ãğ[$_SERVER[ÆªÈ–¬][883]] = $£Š­¥¨; } $»›Ú¢¦Ÿ[] = $_SERVER[ÆªÈ–¬][1144] . $this->sqlEncode($«Õ«×Ãğ) . $_SERVER[ÆªÈ–¬][1145]; } $È•õÚŠË = "\x49\116\123\105\122\124\40\111\116\124\x4f\40\x60{$ıÊ³¨ü¿}\x60\x20\x28\140" . implode($_SERVER[ÆªÈ–¬][1146], $Ä“òêóæ) . $_SERVER[ÆªÈ–¬][1147]; fwrite($—£À¢Ñı, $È•õÚŠË . implode($_SERVER[ÆªÈ–¬][1148], $»›Ú¢¦Ÿ) . $_SERVER[ÆªÈ–¬][74] . PHP_EOL); $Öğ®ÜõÕ += $æ°­’ÙÍ; if ($©¡ñ«Ëõ) { $©¡ñ«Ëõ->update($æ°­’ÙÍ); } } while ($ÍßÖÅÓ == $æ°­’ÙÍ); fclose($—£À¢Ñı); return $Öğ®ÜõÕ; } public function sqlToDb($‘‘×ÈŸœ, &$ìŞŞÍ¹) { $¨è¯©û¯ =& $_SERVER[ÆªÈ–¬]; $éÎÚş‹¾ = $this->model()->db(); $á§Ä¹ÏÅ = @fopen($‘‘×ÈŸœ, $¨è¯©û¯[1149]); if (!$á§Ä¹ÏÅ) { return !1; } $ØŠ¢®Ôç = 0; $ø˜ÜÂ˜» = $¨è¯©û¯[12]; $ôŒúè´… = array(); $µÇå¹¹Ï = $this->dbType(); $ĞÉ¼İãÓ = $µÇå¹¹Ï == $¨è¯©û¯[13] ? 500 : 2000; $”ôÈ–ßô = basename($‘‘×ÈŸœ, $¨è¯©û¯[854]); $ğşÃŒô = 0; $Ë¤Ñ„Ãä = 4194304; while (!feof($á§Ä¹ÏÅ)) { $¶âªîÆ = trim(fgets($á§Ä¹ÏÅ)); if (!$¶âªîÆ) { continue; } $ìƒ‹âÍ‘ = $this->sqlDecode($¶âªîÆ, $µÇå¹¹Ï, $”ôÈ–ßô); if (stripos($ìƒ‹âÍ‘, $¨è¯©û¯[431]) === 0) { if (!$ø˜ÜÂ˜») { $ø˜ÜÂ˜» = $ìƒ‹âÍ‘ . $¨è¯©û¯[53]; } continue; } if ($ìŞŞÍ¹) { $ìŞŞÍ¹->task[$¨è¯©û¯[1134]] += 1; } $ØŠ¢®Ôç++; $ôŒúè´…[] = rtrim(rtrim(trim($ìƒ‹âÍ‘), $¨è¯©û¯[50]), $¨è¯©û¯[74]); $áÏ¯¥‡÷ = null; $â…°àá— = strlen($ìƒ‹âÍ‘); $ğşÃŒô += $â…°àá—; $¢”ŸÏ†ü = strlen($ø˜ÜÂ˜») + $ğşÃŒô + (count($ôŒúè´…) - 1); if ($¢”ŸÏ†ü >= $Ë¤Ñ„Ãä) { $áÏ¯¥‡÷ = array_pop($ôŒúè´…); if ($ØŠ¢®Ôç > 1) { $ØŠ¢®Ôç--; } } if ($ØŠ¢®Ôç >= $ĞÉ¼İãÓ || $áÏ¯¥‡÷) { $ìƒ‹âÍ‘ = $ø˜ÜÂ˜» . implode($¨è¯©û¯[50], $ôŒúè´…); if (!$éÎÚş‹¾->execute($ìƒ‹âÍ‘)) { return !1; } if ($ìŞŞÍ¹) { $ìŞŞÍ¹->update($ØŠ¢®Ôç); } $ôŒúè´… = array(); $ØŠ¢®Ôç = 0; $ğşÃŒô = 0; if ($áÏ¯¥‡÷) { $ôŒúè´… = array($áÏ¯¥‡÷); $ØŠ¢®Ôç = 1; $ğşÃŒô = $â…°àá—; } } } fclose($á§Ä¹ÏÅ); if (!empty($ôŒúè´…)) { $ìƒ‹âÍ‘ = $ø˜ÜÂ˜» . implode($¨è¯©û¯[50], $ôŒúè´…); if (!$éÎÚş‹¾->execute($ìƒ‹âÍ‘)) { return !1; } if ($ìŞŞÍ¹) { $ìŞŞÍ¹->update($ØŠ¢®Ôç); } } return !0; } public function dropTable($ÒÕİöş® = null) { $‰ï™· = $this->model()->db(); $Õ²å¨‡¾ = $ÒÕİöş® ? array($ÒÕİöş®) : $‰ï™·->getTables(); if (!$Õ²å¨‡¾) { return; } foreach ($Õ²å¨‡¾ as $ÒÕİöş®) { if ($ÒÕİöş®) { $ÒÕİöş® = strtolower($ÒÕİöş®); } else { continue; } $‰ï™·->execute("\x64\162\x6f\x70\40\x74\141\142\154\x65\x20\151\146\x20\145\170\x69\x73\x74\x73\40\x60{$ÒÕİöş®}\140"); } } private function sqlEncode($Œ®§Í…–) { $Ì¢£Î¤¬ =& $_SERVER[ÆªÈ–¬]; $¯µ¦……Ù = array(); foreach ($Œ®§Í…– as $•è¡ÀñÑ) { if (is_array($•è¡ÀñÑ)) { $•è¡ÀñÑ = json_encode_force($•è¡ÀñÑ); } $•è¡ÀñÑ = addslashes($•è¡ÀñÑ); $•è¡ÀñÑ = str_replace(array($Ì¢£Î¤¬[1150], $Ì¢£Î¤¬[262], $Ì¢£Î¤¬[418]), array($Ì¢£Î¤¬[1151], $Ì¢£Î¤¬[1152], $Ì¢£Î¤¬[1153]), $•è¡ÀñÑ); $¯µ¦……Ù[] = $•è¡ÀñÑ; } return $Ì¢£Î¤¬[58] . implode($Ì¢£Î¤¬[1154], $¯µ¦……Ù) . $Ì¢£Î¤¬[58]; } private function sqlDecode($æèş©õ, $Í™äƒã‡, $ÔÇğçœ§ = '') { $¹›º‡‘‚ =& $_SERVER[ÆªÈ–¬]; $æèş©õ = str_replace(array($¹›º‡‘‚[1151], $¹›º‡‘‚[1152], $¹›º‡‘‚[1153]), array($¹›º‡‘‚[1150], $¹›º‡‘‚[262], $¹›º‡‘‚[418]), $æèş©õ); if ($Í™äƒã‡ == $¹›º‡‘‚[13]) { $æèş©õ = str_ireplace($¹›º‡‘‚[1155], $¹›º‡‘‚[59], $æèş©õ); $æèş©õ = stripslashes($æèş©õ); } return preg_replace($¹›º‡‘‚[1156], $¹›º‡‘‚[12], $æèş©õ); if ($Í™äƒã‡ == $¹›º‡‘‚[13]) { return $ÔÇğçœ§ != $¹›º‡‘‚[1157] ? stripslashes($æèş©õ) : $æèş©õ; } if ($ÔÇğçœ§ == $¹›º‡‘‚[1157]) { $æèş©õ = str_replace($¹›º‡‘‚[1158], $¹›º‡‘‚[121], stripslashes($æèş©õ)); } return $æèş©õ; } public function getSqlFile($Û¢·¢â = '') { $¶ ¦÷ÓÇ =& $_SERVER[ÆªÈ–¬]; $Òé©å«© = $this->dbType(!0); $øéŠîáÎ = CONTROLLER_DIR . "\151\x6e\x73\164\x61\x6c\154\57\x64\x61\x74\x61\57{$Òé©å«©}\56\163\161\x6c"; $×Æé³æ“ = file_get_contents($øéŠîáÎ); $àË˜÷î¸ = $¶ ¦÷ÓÇ[1159] . ($Òé©å«© == $¶ ¦÷ÓÇ[870] ? $¶ ¦÷ÓÇ[1160] : $¶ ¦÷ÓÇ[1161]) . $¶ ¦÷ÓÇ[1162]; preg_match_all($àË˜÷î¸, $×Æé³æ“, $ğü¨Ú•ú); $¡¿ù›Ş = $ğü¨Ú•ú[1]; $ø‹Ïû®ç = $this->model()->db(); $ä•èğ‹ = $ø‹Ïû®ç->getTables(); $â°ä§Î“ = TEMP_FILES . $¶ ¦÷ÓÇ[1163] . date($¶ ¦÷ÓÇ[272]) . $¶ ¦÷ÓÇ[8]; del_dir($â°ä§Î“); mk_dir($â°ä§Î“); $ ¨ÍÉŸÒ = $â°ä§Î“ . $¶ ¦÷ÓÇ[1164]; $¶Å•´ËÆ = $â°ä§Î“ . $¶ ¦÷ÓÇ[1165]; $ˆîÖèÇ“ = $Òé©å«© == $¶ ¦÷ÓÇ[13] ? $¶ ¦÷ÓÇ[870] : $¶ ¦÷ÓÇ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\154\x2f\144\x61\x74\x61\57{$ˆîÖèÇ“}\x2e\x73\161\x6c", $â°ä§Î“); @touch($â°ä§Î“ . $Òé©å«© . $¶ ¦÷ÓÇ[854]); $¯âÄôÜû = fopen($ ¨ÍÉŸÒ, $¶ ¦÷ÓÇ[1138]); $õèÜøõË = fopen($¶Å•´ËÆ, $¶ ¦÷ÓÇ[1138]); if ($Òé©å«© == $¶ ¦÷ÓÇ[13]) { $ä•èğ‹ = array_diff($ä•èğ‹, array($¶ ¦÷ÓÇ[846], $¶ ¦÷ÓÇ[847])); $¬íéÚÄ = array($¶ ¦÷ÓÇ[1166], $¶ ¦÷ÓÇ[1167], $¶ ¦÷ÓÇ[1168]); fwrite($õèÜøõË, implode(PHP_EOL, $¬íéÚÄ) . PHP_EOL . PHP_EOL); foreach ($ä•èğ‹ as $çµƒ…£ø) { $Óğíç”‹ = $this->sqlFromSqlite($çµƒ…£ø); if (!$Óğíç”‹[$¶ ¦÷ÓÇ[13]]) { continue; } fwrite($õèÜøõË, $Óğíç”‹[$¶ ¦÷ÓÇ[13]] . PHP_EOL . PHP_EOL); if (!in_array($çµƒ…£ø, $¡¿ù›Ş)) { fwrite($¯âÄôÜû, $Óğíç”‹[$¶ ¦÷ÓÇ[870]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ä•èğ‹ as $çµƒ…£ø) { $Óğíç”‹ = $this->sqlFromMysql($çµƒ…£ø); if (!$Óğíç”‹[$¶ ¦÷ÓÇ[870]]) { continue; } fwrite($¯âÄôÜû, $Óğíç”‹[$¶ ¦÷ÓÇ[870]] . PHP_EOL . PHP_EOL); if (!in_array($çµƒ…£ø, $¡¿ù›Ş)) { fwrite($õèÜøõË, $Óğíç”‹[$¶ ¦÷ÓÇ[13]] . PHP_EOL . PHP_EOL); } } } fclose($¯âÄôÜû); fclose($õèÜøõË); $×Æé³æ“ = array($¶ ¦÷ÓÇ[870] => $ ¨ÍÉŸÒ, $¶ ¦÷ÓÇ[13] => $¶Å•´ËÆ); return $Û¢·¢â ? $×Æé³æ“[$Û¢·¢â] : $×Æé³æ“; } public function dbType($Å¤Ä«‘ = false) { $›•àÂ =& $_SERVER[ÆªÈ–¬]; $Ğ…ºğª = $Å¤Ä«‘ ? $GLOBALS[$›•àÂ[6]][$›•àÂ[21]] : $this->database; $Ğ…ºğª = array_change_key_case($Ğ…ºğª); $ÙÆ‹íÃ× = $Ğ…ºğª[$›•àÂ[1038]]; if ($ÙÆ‹íÃ× == $›•àÂ[1035]) { $¿şÌÂ¯Ê = explode($›•àÂ[4], $Ğ…ºğª[$›•àÂ[1044]]); $ÙÆ‹íÃ× = $¿şÌÂ¯Ê[0]; } $Şô•Ñ¥‚ = array($›•àÂ[1169] => $›•àÂ[13], $›•àÂ[983] => $›•àÂ[870]); if (isset($Şô•Ñ¥‚[$ÙÆ‹íÃ×])) { $ÙÆ‹íÃ× = $Şô•Ñ¥‚[$ÙÆ‹íÃ×]; } return $ÙÆ‹íÃ×; } public function sqlFromMysql($êºò±Ö×, $¸½†¿¦å = '') { $É€•ıã½ =& $_SERVER[ÆªÈ–¬]; $¢èğÓÒ = $this->model()->db(); $ˆƒ×‡ää = $¢èğÓÒ->query($É€•ıã½[1170] . $êºò±Ö× . $É€•ıã½[461]); if (!$ˆƒ×‡ää || !$ˆƒ×‡ää[0]) { return !1; } $ãÊÊ¢³ = _get($ˆƒ×‡ää[0], $É€•ıã½[1171], $É€•ıã½[12]); if (!$ãÊÊ¢³) { return !1; } $àäğãÀÑ = "\104\x52\x4f\x50\x20\124\x41\102\x4c\105\40\111\106\x20\x45\x58\x49\x53\x54\123\40\x60{$êºò±Ö×}\140\x3b" . PHP_EOL . $ãÊÊ¢³ . $É€•ıã½[74]; if ($¸½†¿¦å && $¸½†¿¦å == $É€•ıã½[870]) { return $àäğãÀÑ; } $ÛÂÙ¬œ = array_change_key_case($GLOBALS[$É€•ıã½[6]][$É€•ıã½[21]]); $®îÆŸ»» = $ÛÂÙ¬œ[$É€•ıã½[1043]]; $½·Ó Êõ = $É€•ıã½[1172] . $®îÆŸ»» . $É€•ıã½[1173] . $êºò±Ö× . $É€•ıã½[58]; $€æ¥Œ‘ƒ = $É€•ıã½[1174] . $êºò±Ö× . $É€•ıã½[971]; $¿ç¢Çí = $¢èğÓÒ->query($½·Ó Êõ); if (empty($¿ç¢Çí)) { $›Æ´ËˆÃ = array($É€•ıã½[870] => $É€•ıã½[12], $É€•ıã½[13] => $É€•ıã½[12]); return $¸½†¿¦å ? $›Æ´ËˆÃ[$¸½†¿¦å] : $›Æ´ËˆÃ; } $ù¨¨¹§ = $¢èğÓÒ->query($€æ¥Œ‘ƒ); $Ã…£Ëœ° = $É€•ıã½[12]; $Ó­èÆ = array(); foreach ($ù¨¨¹§ as $¨øóí›Æ) { if (!$Ã…£Ëœ° && $¨øóí›Æ[$É€•ıã½[1175]] == $É€•ıã½[1176]) { $Ã…£Ëœ° = $¨øóí›Æ[$É€•ıã½[1177]]; } if (isset($Ó­èÆ[$¨øóí›Æ[$É€•ıã½[1175]]])) { $Ó­èÆ[$¨øóí›Æ[$É€•ıã½[1175]]][$É€•ıã½[1178]][] = $¨øóí›Æ[$É€•ıã½[1177]]; continue; } $Ó­èÆ[$¨øóí›Æ[$É€•ıã½[1175]]] = array($É€•ıã½[1179] => $¨øóí›Æ[$É€•ıã½[1175]], $É€•ıã½[1178] => array($¨øóí›Æ[$É€•ıã½[1177]]), $É€•ıã½[1180] => $¨øóí›Æ[$É€•ıã½[1181]] == $É€•ıã½[91] ? 0 : 1); } $ğ»İâ¾ = array(); foreach ($Ó­èÆ as $¨øóí›Æ) { $Í—Íï’ = $¨øóí›Æ[$É€•ıã½[1179]] == $É€•ıã½[1176]; $îó©¬ = array($É€•ıã½[1182], $¨øóí›Æ[$É€•ıã½[1180]] == $É€•ıã½[91] && !$Í—Íï’ ? $É€•ıã½[1183] : $É€•ıã½[12], $É€•ıã½[1184], $É€•ıã½[1185] . $êºò±Ö× . $É€•ıã½[11] . ($Í—Íï’ ? $É€•ıã½[1186] : $¨øóí›Æ[$É€•ıã½[1179]]) . $É€•ıã½[121], $É€•ıã½[1187], $É€•ıã½[121] . $êºò±Ö× . $É€•ıã½[121], $É€•ıã½[1188] . implode($É€•ıã½[1189], $¨øóí›Æ[$É€•ıã½[1178]]) . $É€•ıã½[1190]); $ğ»İâ¾[] = implode($É€•ıã½[53], $îó©¬) . $É€•ıã½[74]; } $ŠÅ÷«¨– = array(); $Ÿ­“³¥Ë = array($É€•ıã½[1191] => $É€•ıã½[1192], $É€•ıã½[1192] => $É€•ıã½[1192], $É€•ıã½[364] => $É€•ıã½[391], $É€•ıã½[363] => $É€•ıã½[391]); foreach ($¿ç¢Çí as $¨øóí›Æ) { $îó©¬ = array($É€•ıã½[121] . $¨øóí›Æ[$É€•ıã½[1193]] . $É€•ıã½[121], isset($Ÿ­“³¥Ë[$¨øóí›Æ[$É€•ıã½[1194]]]) ? $Ÿ­“³¥Ë[$¨øóí›Æ[$É€•ıã½[1194]]] : $¨øóí›Æ[$É€•ıã½[1195]], $¨øóí›Æ[$É€•ıã½[1196]] == $É€•ıã½[969] ? $É€•ıã½[1197] : $É€•ıã½[1198], $¨øóí›Æ[$É€•ıã½[1193]] == $Ã…£Ëœ° ? $É€•ıã½[1199] : $É€•ıã½[12], $¨øóí›Æ[$É€•ıã½[1020]] ? strtoupper(str_replace($É€•ıã½[11], $É€•ıã½[12], $¨øóí›Æ[$É€•ıã½[1020]])) : $É€•ıã½[12]); $ŠÅ÷«¨–[] = trim(implode($É€•ıã½[53], $îó©¬)); } $¬ ÖŞ²³ = array($É€•ıã½[1200] . $êºò±Ö× . $É€•ıã½[1201], $É€•ıã½[1202] . $êºò±Ö× . $É€•ıã½[1203], implode($É€•ıã½[50] . PHP_EOL, $ŠÅ÷«¨–), $É€•ıã½[1017]); $Ø„áåà‚ = implode(PHP_EOL, array_merge($¬ ÖŞ²³, $ğ»İâ¾)); if ($¸½†¿¦å && $¸½†¿¦å == $É€•ıã½[13]) { return $Ø„áåà‚; } $›Æ´ËˆÃ = array($É€•ıã½[870] => $àäğãÀÑ, $É€•ıã½[13] => $Ø„áåà‚); return $¸½†¿¦å ? $›Æ´ËˆÃ[$¸½†¿¦å] : $›Æ´ËˆÃ; } public function sqlFromSqlite($—Äñ‡¤, $üÍÑÒí = '') { $“°‹ê” =& $_SERVER[ÆªÈ–¬]; $Íì«ˆè¬ = $this->model()->db(); $€˜ô±„« = "\x50\122\x41\107\x4d\101\40\x54\x41\x42\x4c\105\x5f\x49\116\x46\x4f\x20\50\x27{$—Äñ‡¤}\47\51"; $ÜÈÚ¬Î¾ = "\123\x45\114\x45\x43\x54\40\x2a\x20\x46\122\117\115\40\x73\x71\x6c\151\x74\145\x5f\x6d\141\x73\x74\145\162\40\127\x48\x45\122\105\x20\164\x62\154\x5f\156\141\155\145\40\x3d\40\x27{$—Äñ‡¤}\47"; $Ï¬Ôš× = $Íì«ˆè¬->query($€˜ô±„«); if (empty($Ï¬Ôš×)) { $…œ¨¶÷ = array($“°‹ê”[870] => $“°‹ê”[12], $“°‹ê”[13] => $“°‹ê”[12]); return $üÍÑÒí ? $…œ¨¶÷[$üÍÑÒí] : $…œ¨¶÷; } $×øØ´¸ı = $Íì«ˆè¬->query($ÜÈÚ¬Î¾); $âÂæ‹¢Ã = $£¤Šú¬É = array(); foreach ($×øØ´¸ı as $ñÒ†èİ) { if ($ñÒ†èİ[$“°‹ê”[33]] == $“°‹ê”[356]) { $âÂæ‹¢Ã[] = $ñÒ†èİ[$“°‹ê”[1204]]; } else { $£¤Šú¬É[$ñÒ†èİ[$“°‹ê”[32]]] = $ñÒ†èİ[$“°‹ê”[1204]]; } } $†Šô’›Ù = array_merge(array($“°‹ê”[1200] . $—Äñ‡¤ . $“°‹ê”[121]), $âÂæ‹¢Ã, array_values($£¤Šú¬É)); $†Šô’›Ù = implode($“°‹ê”[74] . PHP_EOL, $†Šô’›Ù) . $“°‹ê”[74]; if ($üÍÑÒí && $üÍÑÒí == $“°‹ê”[13]) { return $†Šô’›Ù; } $ÖíøÇæ™ = array(); $È·‡äúÚ = array($“°‹ê”[1192] => $“°‹ê”[1205], $“°‹ê”[391] => $“°‹ê”[1206]); $Æ¿¿š²ê = $“°‹ê”[12]; foreach ($Ï¬Ôš× as $ñÒ†èİ) { if ($ñÒ†èİ[$“°‹ê”[57]] == $“°‹ê”[91]) { $Æ¿¿š²ê = $ñÒ†èİ[$“°‹ê”[32]]; } $±ğ±‹³º = array($“°‹ê”[461] . $ñÒ†èİ[$“°‹ê”[32]] . $“°‹ê”[461], isset($È·‡äúÚ[$ñÒ†èİ[$“°‹ê”[33]]]) ? $È·‡äúÚ[$ñÒ†èİ[$“°‹ê”[33]]] : $ñÒ†èİ[$“°‹ê”[33]], $ñÒ†èİ[$“°‹ê”[35]] == $“°‹ê”[91] ? $“°‹ê”[1197] : $“°‹ê”[1207] . $ñÒ†èİ[$“°‹ê”[56]], $ñÒ†èİ[$“°‹ê”[57]] == $“°‹ê”[91] ? $“°‹ê”[1208] : $“°‹ê”[12]); $ÖíøÇæ™[] = trim(implode($“°‹ê”[53], $±ğ±‹³º)); } foreach ($£¤Šú¬É as $Îê¤ıĞ => $Ÿ†¯‡) { $“’û…®³ = str_replace($“°‹ê”[1209] . $—Äñ‡¤ . $“°‹ê”[11], $“°‹ê”[12], $Îê¤ıĞ); $²ÛØéœ = str_replace(array($“°‹ê”[121], $“°‹ê”[1028]), $“°‹ê”[461], substr($Ÿ†¯‡, stripos($Ÿ†¯‡, $“°‹ê”[337]))); if ($“’û…®³ == $“°‹ê”[1186]) { $©ášô–¢ = $“°‹ê”[1210] . $Æ¿¿š²ê . $“°‹ê”[1211]; } else { $©ášô–¢ = (stripos($“’û…®³, $“°‹ê”[11]) ? $“°‹ê”[1212] : $“°‹ê”[12]) . ($“°‹ê”[1213] . $“’û…®³ . $“°‹ê”[1214] . $²ÛØéœ); } $ÖíøÇæ™[] = $©ášô–¢; } $ô©Œ½Ô = array($“°‹ê”[1215] . $—Äñ‡¤ . $“°‹ê”[1216], $“°‹ê”[1217] . $—Äñ‡¤ . $“°‹ê”[1218], implode($“°‹ê”[50] . PHP_EOL, $ÖíøÇæ™), $“°‹ê”[1219]); $¥œ¯Ò‚­ = implode(PHP_EOL, $ô©Œ½Ô); if ($üÍÑÒí && $üÍÑÒí == $“°‹ê”[870]) { return $¥œ¯Ò‚­; } $…œ¨¶÷ = array($“°‹ê”[870] => $¥œ¯Ò‚­, $“°‹ê”[13] => $†Šô’›Ù); return $üÍÑÒí ? $…œ¨¶÷[$üÍÑÒí] : $…œ¨¶÷; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Çí«ñĞÅ, $ÁÆ¾Öîä) { $Ş¹¼’‰Ø =& $_SERVER[ÆªÈ–¬]; $ÚÅöô…õ = $ÁÆ¾Öîä; $GLOBALS[$Ş¹¼’‰Ø[1220]] = $Ş¹¼’‰Ø[1221] . $Çí«ñĞÅ; Hook::trigger($Ş¹¼’‰Ø[1221] . $Çí«ñĞÅ . $Ş¹¼’‰Ø[1222], $ÚÅöô…õ); $ÄƒàØ´¡ = self::driverMake($ÁÆ¾Öîä[0]); if (!$ÄƒàØ´¡) { return !1; } if (method_exists($ÄƒàØ´¡, $Çí«ñĞÅ)) { $ÑüüòÖñ = @call_user_func_array(array($ÄƒàØ´¡, $Çí«ñĞÅ), $ÁÆ¾Öîä); } else { if (method_exists($ÄƒàØ´¡, $Ş¹¼’‰Ø[1223])) { $ÑüüòÖñ = @call_user_func_array(array($ÄƒàØ´¡, $Çí«ñĞÅ), $ÁÆ¾Öîä); } else { if (method_exists(self, $Çí«ñĞÅ)) { $ÑüüòÖñ = @call_user_func_array(array(self, $Çí«ñĞÅ), $ÁÆ¾Öîä); } else { $ÑüüòÖñ = call_user_func_array(array(parent, $Çí«ñĞÅ), $ÁÆ¾Öîä); } } } Hook::trigger($Ş¹¼’‰Ø[1221] . $Çí«ñĞÅ . $Ş¹¼’‰Ø[1224], $ÚÅöô…õ, $ÑüüòÖñ); return $ÑüüòÖñ; } public static function init($Ú¡ à“³) { return self::driverMake($Ú¡ à“³); } public static function copy($Ç‹×Ş«ñ, $ÒÌéÚ•£, $Í™èâ = false, $ºíåÚ = false) { return self::copyMoveStart($Ç‹×Ş«ñ, $ÒÌéÚ•£, $Í™èâ, $_SERVER[ÆªÈ–¬][618], $ºíåÚ); } public static function move($ºÏùß², $å¬ÄïÈ±, $Á´Ç˜Ï„ = false, $Ö±ü²õº = false) { return self::copyMoveStart($ºÏùß², $å¬ÄïÈ±, $Á´Ç˜Ï„, $_SERVER[ÆªÈ–¬][620], $Ö±ü²õº); } private static function copyMoveStart($ÆÁ¨ŞÍÄ, $×ÅóŞ¢”, $ÙÇÏæ‹, $ç¤’î¯÷, $Ò¹ñÔÙÁ) { $úÒµº¨ =& $_SERVER[ÆªÈ–¬]; $ú•×óá = array($ÆÁ¨ŞÍÄ, $×ÅóŞ¢”, $ÙÇÏæ‹, $Ò¹ñÔÙÁ); Hook::trigger($úÒµº¨[1221] . $ç¤’î¯÷ . $úÒµº¨[1222], $ú•×óá); $§öÛ×¿Œ = self::copyMove($ÆÁ¨ŞÍÄ, $×ÅóŞ¢”, $ÙÇÏæ‹, $ç¤’î¯÷, $Ò¹ñÔÙÁ); Hook::trigger($úÒµº¨[1221] . $ç¤’î¯÷ . $úÒµº¨[1224], $ú•×óá, $§öÛ×¿Œ); return $§öÛ×¿Œ; } public static function saveFile($èÀÄÌ†Ê, $¡ŠÑÕ£é, $ÚÚ÷®• = true) { $·‚îæíæ =& $_SERVER[ÆªÈ–¬]; $äıÓ¨»‘ = self::info($¡ŠÑÕ£é); $µáÖ¡È¹ = self::driverMake($èÀÄÌ†Ê); $·ó»ó™ = self::driverMake($¡ŠÑÕ£é); $ûÑõ˜“‘ = !1; if ($·ó»ó™->pathParse[$·‚îæíæ[1225]]) { $ûÑõ˜“‘ = $·ó»ó™; $§¤•¬à = $·ó»ó™->pathParse[$·‚îæíæ[1225]]; $·ó»ó™ = self::driverMake($§¤•¬à); } if ($µáÖ¡È¹->pathParse[$·‚îæíæ[1225]]) { $‰±É´¸é = $µáÖ¡È¹->pathParse[$·‚îæíæ[1225]]; $µáÖ¡È¹ = self::driverMake($‰±É´¸é); } $İüè‰† = $·ó»ó™->pathFather($¡ŠÑÕ£é); $ÈŸ²…ì‹ = !0; if (!$ÚÚ÷®• && self::driverIsSame($µáÖ¡È¹, $·ó»ó™)) { $ÈŸ²…ì‹ = !1; } $äÀÜõß° = self::copyFile($µáÖ¡È¹, $èÀÄÌ†Ê, $·ó»ó™, $İüè‰†, $äıÓ¨»‘[$·‚îæíæ[32]], $ÈŸ²…ì‹); if ($ûÑõ˜“‘) { $äÀÜõß° = $ûÑõ˜“‘->getPathOuter($äÀÜõß°); } return $äÀÜõß°; } private static function copyMove($×ÙûñâŸ, $ú´„şöÅ, $¥òÙ°Ù, $ÍŠš²ìõ, $°ÍğË€³ = false) { $´·¥À° =& $_SERVER[ÆªÈ–¬]; if (!$×ÙûñâŸ || $×ÙûñâŸ == $´·¥À°[8] || !$ú´„şöÅ) { return !1; } ignore_timeout(); $ÖìÀº©ö = self::driverMake($×ÙûñâŸ); $ò ‡ßø© = self::driverMake($ú´„şöÅ); $ğ¶‚ËÕ = $ÍŠš²ìõ == $´·¥À°[620]; $ƒ•¼Äñ = !1; if ($ò ‡ßø©->pathParse[$´·¥À°[1225]]) { $ƒ•¼Äñ = $ò ‡ßø©; $ú´„şöÅ = $ò ‡ßø©->pathParse[$´·¥À°[1225]]; $ò ‡ßø© = self::driverMake($ú´„şöÅ); } if ($ÖìÀº©ö->pathParse[$´·¥À°[1225]]) { $×ÙûñâŸ = $ÖìÀº©ö->pathParse[$´·¥À°[1225]]; $ÖìÀº©ö = self::driverMake($×ÙûñâŸ); } self::check($ÖìÀº©ö, $×ÙûñâŸ, $ò ‡ßø©, $ú´„şöÅ); Hook::trigger($´·¥À°[1226], $ÖìÀº©ö, $×ÙûñâŸ, $ò ‡ßø©, $ú´„şöÅ); $±óÔó³ = self::driverIsSame($ÖìÀº©ö, $ò ‡ßø©); if ($±óÔó³) { if ($ÍŠš²ìõ == $´·¥À°[620] && !method_exists($ò ‡ßø©, $´·¥À°[1227]) && trim($ú´„şöÅ, $´·¥À°[8]) == trim($ò ‡ßø©->pathFather($×ÙûñâŸ), $´·¥À°[8])) { if ($ÖìÀº©ö->pathThis($×ÙûñâŸ) != $°ÍğË€³ && !$ÖìÀº©ö->isOsDriver()) { return $ÖìÀº©ö->rename($×ÙûñâŸ, $°ÍğË€³); } return $ò ‡ßø©->getPathOuter($×ÙûñâŸ); } if (method_exists($ò ‡ßø©, $ÍŠš²ìõ)) { return $ò ‡ßø©->{$ÍŠš²ìõ}($×ÙûñâŸ, $ú´„şöÅ, $¥òÙ°Ù, $°ÍğË€³); } } if ($±óÔó³ && $ÍŠš²ìõ == $´·¥À°[620] && $ò ‡ßø©->getType() == $´·¥À°[109]) { $¤é¿“› = $ò ‡ßø©->movePath($×ÙûñâŸ, $ú´„şöÅ, $°ÍğË€³); if ($¤é¿“›) { return $¤é¿“›; } } $øÏîéö = $ÖìÀº©ö->isFile($×ÙûñâŸ); if (!$øÏîéö && $ò ‡ßø©->getType() == $´·¥À°[823] && $ÖìÀº©ö->getType() == $´·¥À°[109]) { $¤é¿“› = $ò ‡ßø©->copyFolderFromIO($ÖìÀº©ö, $×ÙûñâŸ, $ú´„şöÅ, $¥òÙ°Ù, $ğ¶‚ËÕ, $°ÍğË€³); } else { $¤é¿“› = self::copyPath($ÖìÀº©ö, $×ÙûñâŸ, $ò ‡ßø©, $ú´„şöÅ, $¥òÙ°Ù, $ğ¶‚ËÕ, $øÏîéö, $°ÍğË€³); } if ($¤é¿“› && $ğ¶‚ËÕ) { $ÖìÀº©ö->remove($×ÙûñâŸ); } if ($ƒ•¼Äñ) { $¤é¿“› = $ƒ•¼Äñ->getPathOuter($¤é¿“›); } return $¤é¿“›; } private static function check($øåï÷ş½, $é…Ô¾Ùˆ, $Ëè¿°õ, &$§Õ—Å§Ø) { $Øù—ÀõÒ =& $_SERVER[ÆªÈ–¬]; if (self::driverIsSame($øåï÷ş½, $Ëè¿°õ) && $øåï÷ş½->isFolder($é…Ô¾Ùˆ) && $øåï÷ş½->isParentOf($é…Ô¾Ùˆ, $§Õ—Å§Ø)) { show_json(LNG($Øù—ÀõÒ[1228]), !1); } if (!$øåï÷ş½->exist($é…Ô¾Ùˆ)) { show_json(LNG($Øù—ÀõÒ[108]), !1); } } private static function copyPath($ëĞå¼, $£ÊÇ»¨, $Åæ¥ÃûÂ, $Õ¿œ†, $úˆï¦, $ñÇÅ°§¡, $‡“ñ²ÁÁ, $«İæóöê = false, $–”±ã’ë = true) { $ˆ‡ÛòÑ“ =& $_SERVER[ÆªÈ–¬]; $æíšà½ = empty($«İæóöê) && $«İæóöê !== $ˆ‡ÛòÑ“[228] ? $ëĞå¼->pathThis($£ÊÇ»¨) : $«İæóöê; if ($úˆï¦) { $ó›Ó§­ª = $Åæ¥ÃûÂ->fileNameExist($Õ¿œ†, $æíšà½); $ôûÓÆ‰Ö = $æíšà½; $æíšà½ = $Åæ¥ÃûÂ->fileNameAuto($Õ¿œ†, $æíšà½, $úˆï¦, !$‡“ñ²ÁÁ); if (!$ó›Ó§­ª || $ôûÓÆ‰Ö != $æíšà½) { $úˆï¦ = !1; } if ($–”±ã’ë && !$úˆï¦) { $Åæ¥ÃûÂ->_data[$ˆ‡ÛòÑ“[1229]] = !0; } } if ($‡“ñ²ÁÁ) { return self::copyFile($ëĞå¼, $£ÊÇ»¨, $Åæ¥ÃûÂ, $Õ¿œ†, $æíšà½, $ñÇÅ°§¡); } if ($úˆï¦ == REPEAT_RENAME_FOLDER) { $úˆï¦ = !1; } $µ™™ñ» = rtrim($Õ¿œ†, $ˆ‡ÛòÑ“[8]) . $ˆ‡ÛòÑ“[8] . $æíšà½; $ÉŸ™ Š = $Åæ¥ÃûÂ->mkdir($Åæ¥ÃûÂ->getPath($µ™™ñ»), $úˆï¦); $Õ¿œ† = $Åæ¥ÃûÂ->getPathInner($ÉŸ™ Š); $ª—¢­İ = $ëĞå¼->listPath($£ÊÇ»¨, !0); $ª—¢­İ = is_array($ª—¢­İ) ? $ª—¢­İ : array($ˆ‡ÛòÑ“[86] => array(), $ˆ‡ÛòÑ“[85] => array()); $©ÂºÙş = array_merge($ª—¢­İ[$ˆ‡ÛòÑ“[86]], $ª—¢­İ[$ˆ‡ÛòÑ“[85]]); foreach ($©ÂºÙş as $†Ñ•ÏŠİ) { $ÀŞËÅ‚· = $†Ñ•ÏŠİ[$ˆ‡ÛòÑ“[33]] == $ˆ‡ÛòÑ“[230]; $£ÊÇ»¨ = $ëĞå¼->getPathInner($†Ñ•ÏŠİ[$ˆ‡ÛòÑ“[87]]); $ìïÎ´éË = self::copyPath($ëĞå¼, $£ÊÇ»¨, $Åæ¥ÃûÂ, $Õ¿œ†, $úˆï¦, $ñÇÅ°§¡, $ÀŞËÅ‚·, !1, !1); if (!$ìïÎ´éË) { IO::errorTips($ˆ‡ÛòÑ“[1230] . $£ÊÇ»¨ . $ˆ‡ÛòÑ“[73] . $Õ¿œ†); } } self::copyMoveKeepInfo($ëĞå¼, $£ÊÇ»¨, $ÉŸ™ Š); return $ÉŸ™ Š; } private static function copyFile($ŸÓ¨¹²ù, $¤ùÉ‘Şâ, $”ùâÄ–‰, $™…×œ«¥, $êÈû İÓ, $¼Ûõ¸ó…) { $—öÈÇ¡ =& $_SERVER[ÆªÈ–¬]; $™…×œ«¥ = $”ùâÄ–‰->getPath(rtrim($™…×œ«¥, $—öÈÇ¡[8]) . $—öÈÇ¡[8] . $êÈû İÓ); $›ÏµÄåÏ = $—öÈÇ¡[1231] . time() . rand_string(5); Hook::trigger($—öÈÇ¡[1232], $ŸÓ¨¹²ù, $¤ùÉ‘Şâ, $”ùâÄ–‰, $™…×œ«¥, $êÈû İÓ, $›ÏµÄåÏ); if (self::driverIsSame($ŸÓ¨¹²ù, $”ùâÄ–‰)) { if ($¼Ûõ¸ó…) { $—¾² = $”ùâÄ–‰->moveFile($¤ùÉ‘Şâ, $™…×œ«¥); } else { $—¾² = $”ùâÄ–‰->copyFile($¤ùÉ‘Şâ, $™…×œ«¥); } Hook::trigger($—öÈÇ¡[1233], $ŸÓ¨¹²ù, $¤ùÉ‘Şâ, $”ùâÄ–‰, $™…×œ«¥, $êÈû İÓ, $—¾²); self::copyMoveKeepInfo($ŸÓ¨¹²ù, $¤ùÉ‘Şâ, $—¾²); return $—¾²; } $ÏĞïÍ©½ = TEMP_FILES; if ($GLOBALS[$—öÈÇ¡[6]][$—öÈÇ¡[92]][$—öÈÇ¡[862]]) { $ÏĞïÍ©½ = $GLOBALS[$—öÈÇ¡[6]][$—öÈÇ¡[92]][$—öÈÇ¡[862]]; } $ª­Ä›ƒ³ = $ÏĞïÍ©½; mk_dir($ª­Ä›ƒ³); $¦ˆ¯áö° = $ª­Ä›ƒ³ . $›ÏµÄåÏ; $Îá÷àƒü = $¦ˆ¯áö°; $¦ˆ¯áö° = $ŸÓ¨¹²ù->download($¤ùÉ‘Şâ, $¦ˆ¯áö°); $¦ˆ¯áö° = $ŸÓ¨¹²ù->iconvApp($¦ˆ¯áö°); if (substr($¦ˆ¯áö°, strlen($ÏĞïÍ©½)) == $ÏĞïÍ©½) { $¼Ûõ¸ó… = !0; } $—¾² = $”ùâÄ–‰->upload($™…×œ«¥, $¦ˆ¯áö°, $¼Ûõ¸ó…); self::remove($Îá÷àƒü); Hook::trigger($—öÈÇ¡[1233], $ŸÓ¨¹²ù, $¤ùÉ‘Şâ, $”ùâÄ–‰, $™…×œ«¥, $êÈû İÓ, $—¾²); self::copyMoveKeepInfo($ŸÓ¨¹²ù, $¤ùÉ‘Şâ, $—¾²); return $—¾²; } private static function copyMoveKeepInfo($Ï‡Ì™Š“, $­¥ˆ¢¸ï, $ôîıÒ…«) { if (!$ôîıÒ…«) { return; } $—ê·Å = $Ï‡Ì™Š“->info($­¥ˆ¢¸ï); if (!is_array($—ê·Å)) { return; } IO::setModifyTime($ôîıÒ…«, $—ê·Å[$_SERVER[ÆªÈ–¬][88]]); } public static function pathFather($É¼ü·Ã) { $ÂèŠÚ± = IO::init($É¼ü·Ã); $ŠŸ‚²§Í = $ÂèŠÚ±->pathFather($ÂèŠÚ±->path); return $ÂèŠÚ±->getPathOuter($ŠŸ‚²§Í); } public static function fileOut($©ëÂ€•, $Ï™Ø¦Ä„ = false, $ËÉâ¥äÌ = false, $€ìŠ€ƒÇ = '') { $ã«Î“œ = self::driverMake($©ëÂ€•); if ($ã«Î“œ->isFileOutServer()) { return $ã«Î“œ->fileOutServer($©ëÂ€•, $Ï™Ø¦Ä„, $ËÉâ¥äÌ, $€ìŠ€ƒÇ); } return $ã«Î“œ->fileOut($©ëÂ€•, $Ï™Ø¦Ä„, $ËÉâ¥äÌ, $€ìŠ€ƒÇ); } public static function fileOutImage($†³¤ÎÀ, $˜çÃåâ÷ = 250) { $×¨»¿•É = array(250, 600, 1200, 2000, 3000, 5000); for ($Ë¯ç®§„ = 0; $Ë¯ç®§„ < count($×¨»¿•É); $Ë¯ç®§„++) { if ($Ë¯ç®§„ == 0 && $˜çÃåâ÷ <= $×¨»¿•É[$Ë¯ç®§„]) { $˜çÃåâ÷ = $×¨»¿•É[$Ë¯ç®§„]; break; } else { if ($˜çÃåâ÷ > $×¨»¿•É[$Ë¯ç®§„ - 1] && $˜çÃåâ÷ <= $×¨»¿•É[$Ë¯ç®§„]) { $˜çÃåâ÷ = $×¨»¿•É[$Ë¯ç®§„]; break; } else { if ($Ë¯ç®§„ == count($×¨»¿•É) - 1 && $˜çÃåâ÷ > $×¨»¿•É[$Ë¯ç®§„]) { $˜çÃåâ÷ = $×¨»¿•É[$Ë¯ç®§„]; break; } } } } $‘öğÏì© = self::driverMake($†³¤ÎÀ); if ($‘öğÏì©->isFileOutServer()) { return $‘öğÏì©->fileOutImageServer($†³¤ÎÀ, $˜çÃåâ÷); } return $‘öğÏì©->fileOutImage($†³¤ÎÀ, $˜çÃåâ÷); } private static function driverIsSame($˜ƒ×íÈ², $„İÀà§) { $ÖÀØ«³í =& $_SERVER[ÆªÈ–¬]; $÷¨µ©Ø§ = $˜ƒ×íÈ²->getType(); $ìòÌ¹‚Š = $„İÀà§->getType(); if ($÷¨µ©Ø§ != $ìòÌ¹‚Š) { return !1; } if ($÷¨µ©Ø§ == $ÖÀØ«³í[823]) { return !0; } if ($÷¨µ©Ø§ == $ÖÀØ«³í[109]) { return !0; } if ($˜ƒ×íÈ²->pathDriver == $„İÀà§->pathDriver) { return !0; } return !1; } public static function copyUpdate($ï«ˆÄĞÉ, $ÆË‰ñŸÊ) { $ÀóÉæØÈ =& $_SERVER[ÆªÈ–¬]; if (!IO::exist($ï«ˆÄĞÉ)) { return !1; } if (!IO::exist($ÆË‰ñŸÊ)) { IO::mkdir($ÆË‰ñŸÊ); } $‰Ôê¤˜ = array_to_keyvalue(self::listAllSimple($ï«ˆÄĞÉ), $ÀóÉæØÈ[87]); $æÅş’“‹ = array_to_keyvalue(self::listAllSimple($ÆË‰ñŸÊ), $ÀóÉæØÈ[87]); $¼§¬‡ó = array(); $Ÿ‹°·«Ú = array(); foreach ($‰Ôê¤˜ as $º¥ä÷©å => $îÃ‹¸âÉ) { if (isset($æÅş’“‹[$º¥ä÷©å])) { if ($îÃ‹¸âÉ[$ÀóÉæØÈ[78]] == 1) { continue; } if ($æÅş’“‹[$º¥ä÷©å][$ÀóÉæØÈ[79]] == $îÃ‹¸âÉ[$ÀóÉæØÈ[79]]) { continue; } } if ($îÃ‹¸âÉ[$ÀóÉæØÈ[78]] == 1) { $Ÿ‹°·«Ú[] = $ÆË‰ñŸÊ . $ÀóÉæØÈ[8] . trim($º¥ä÷©å, $ÀóÉæØÈ[8]); continue; } $ó÷ÎÜü¥ = strstr(trim($º¥ä÷©å, $ÀóÉæØÈ[8]), $ÀóÉæØÈ[8]) ? get_path_father($º¥ä÷©å) : $ÀóÉæØÈ[12]; $¼§¬‡ó[] = array($ÀóÉæØÈ[1234] => $îÃ‹¸âÉ[$ÀóÉæØÈ[89]], $ÀóÉæØÈ[1235] => rtrim($ÆË‰ñŸÊ, $ÀóÉæØÈ[8]) . $ÀóÉæØÈ[8] . $ó÷ÎÜü¥, $ÀóÉæØÈ[1236] => $îÃ‹¸âÉ); } $¡ÎÌê‚ = array($ÀóÉæØÈ[230] => $¼§¬‡ó, $ÀóÉæØÈ[78] => $Ÿ‹°·«Ú); Hook::trigger($ÀóÉæØÈ[1237], $ï«ˆÄĞÉ, $ÆË‰ñŸÊ, $¡ÎÌê‚); foreach ($Ÿ‹°·«Ú as $îÃ‹¸âÉ) { IO::mkdir($îÃ‹¸âÉ); } foreach ($¼§¬‡ó as $îÃ‹¸âÉ) { IO::copy($îÃ‹¸âÉ[$ÀóÉæØÈ[1234]], $îÃ‹¸âÉ[$ÀóÉæØÈ[1235]], REPEAT_REPLACE); } } public static function fileSubstr($ÃåËı÷Ã, $¸¬ª³ŸÇ, $ó—Æ¼ = false) { $àöûÔÊì =& $_SERVER[ÆªÈ–¬]; $–£Â’¾™ = self::driverMake($ÃåËı÷Ã); $ü¨Ô’‰ö = $–£Â’¾™->size($ÃåËı÷Ã); $Ûıß§¦ô = $¸¬ª³ŸÇ; $ä åŸÂ = $ó—Æ¼; if ($¸¬ª³ŸÇ < 0) { $¸¬ª³ŸÇ = $ü¨Ô’‰ö + $¸¬ª³ŸÇ; } if ($ó—Æ¼ === !1) { $ó—Æ¼ = $ü¨Ô’‰ö - $¸¬ª³ŸÇ; } if ($¸¬ª³ŸÇ + $ó—Æ¼ > $ü¨Ô’‰ö) { $ó—Æ¼ = $ü¨Ô’‰ö - $¸¬ª³ŸÇ; } if (!$ü¨Ô’‰ö && $–£Â’¾™->getType() == $àöûÔÊì[109] && !$–£Â’¾™->exist($ÃåËı÷Ã)) { $á‹èºì¡ = get_path_this($ÃåËı÷Ã); $¢öà¥’é = parse_url_query($á‹èºì¡); if (is_array($¢öà¥’é) && isset($¢öà¥’é[$àöûÔÊì[32]])) { $á‹èºì¡ = urldecode($¢öà¥’é[$àöûÔÊì[32]]); } throw new Exception($àöûÔÊì[1238] . LNG($àöûÔÊì[1239]) . $àöûÔÊì[1037] . clear_html($á‹èºì¡) . $àöûÔÊì[12]); } if ($ó—Æ¼ <= 0) { return $àöûÔÊì[12]; } if ($¸¬ª³ŸÇ < 0 || $¸¬ª³ŸÇ >= $ü¨Ô’‰ö || $ó—Æ¼ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\x52\145\x61\144\40\145\x72\x72\157\162\x21\40\163\164\x61\162\x74\75{$¸¬ª³ŸÇ}\x3b\154\x65\156\147\x74\150\75{$ó—Æ¼}\73\40\163\x69\172\145\75{$ü¨Ô’‰ö}\x3b"); } $ÁïÚÛä = $–£Â’¾™->fileSubstr($ÃåËı÷Ã, $¸¬ª³ŸÇ, $ó—Æ¼); if (!$ÁïÚÛä && $ó—Æ¼ && isset($GLOBALS[$àöûÔÊì[1240]])) { throw new Exception($GLOBALS[$àöûÔÊì[1240]][$àöûÔÊì[1241]]); } return $ÁïÚÛä; } private static function driverMake(&$á€•»ğ) { $ÕÆ¦ªÉ =& $_SERVER[ÆªÈ–¬]; $ûó”¬Ú¦ = KodIO::parse($á€•»ğ); if (!self::$driverListSystem) { $÷êöó”› = Model($ÕÆ¦ªÉ[833])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($÷êöó”›, $ÕÆ¦ªÉ[475]); } if ($ûó”¬Ú¦[$ÕÆ¦ªÉ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ûó”¬Ú¦[$ÕÆ¦ªÉ[475]]]) { throw new Exception($ÕÆ¦ªÉ[1242]); return !1; } $á€•»ğ = $ûó”¬Ú¦[$ÕÆ¦ªÉ[1243]]; $·‹ÒÄÓ = self::driverGet($ûó”¬Ú¦, $á€•»ğ); return $·‹ÒÄÓ; } private static function driverGet($éÛ÷Ÿ·ï, &$Àé«ÁÄ€) { $’Ó•ãÛÍ =& $_SERVER[ÆªÈ–¬]; $´’é…«à = $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[1244]]; $¿’º±Úí = $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[475]]; switch ($éÛ÷Ÿ·ï[$’Ó•ãÛÍ[33]]) { case KodIO::KOD_IO: $Î¡˜óúí = self::$driverListSystem[$¿’º±Úí]; break; case KodIO::KOD_SOURCE: $Àé«ÁÄ€ = $¿’º±Úí . $Àé«ÁÄ€; $Î¡˜óúí = array($’Ó•ãÛÍ[1245] => $’Ó•ãÛÍ[1246], $’Ó•ãÛÍ[6] => $éÛ÷Ÿ·ï); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ğÁÖ¬á¡ = $GLOBALS[$’Ó•ãÛÍ[1247]]; self::$driverListUser = array_to_keyvalue($ğÁÖ¬á¡, $’Ó•ãÛÍ[475]); } $Î¡˜óúí = self::$driverListUser[$¿’º±Úí]; break; case KodIO::KOD_SHARE_LINK: $Î¡˜óúí = array($’Ó•ãÛÍ[1245] => $’Ó•ãÛÍ[1248], $’Ó•ãÛÍ[6] => $éÛ÷Ÿ·ï); $Ò—Ää = Action($’Ó•ãÛÍ[1249])->sharePathInfo($éÛ÷Ÿ·ï[$’Ó•ãÛÍ[87]]); $Àé«ÁÄ€ = $Ò—Ää[$’Ó•ãÛÍ[193]]; if (!$Ò—Ää[$’Ó•ãÛÍ[193]]) { $³ß´â’¤ = Model($’Ó•ãÛÍ[664])->getInfo($Ò—Ää[$’Ó•ãÛÍ[665]]); $Àé«ÁÄ€ = KodIO::clear($³ß´â’¤[$’Ó•ãÛÍ[1250]] . $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[1243]]); $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[560]] = $³ß´â’¤; $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[1225]] = $Àé«ÁÄ€; $Î¡˜óúí = array($’Ó•ãÛÍ[1245] => $’Ó•ãÛÍ[1251], $’Ó•ãÛÍ[6] => $éÛ÷Ÿ·ï); } break; case KodIO::KOD_SHARE_ITEM: $Î¡˜óúí = array($’Ó•ãÛÍ[1245] => $’Ó•ãÛÍ[1252], $’Ó•ãÛÍ[6] => $éÛ÷Ÿ·ï); $³ß´â’¤ = Model($’Ó•ãÛÍ[664])->getInfo($éÛ÷Ÿ·ï[$’Ó•ãÛÍ[475]]); if ($³ß´â’¤[$’Ó•ãÛÍ[193]] == $’Ó•ãÛÍ[228]) { $Àé«ÁÄ€ = KodIO::clear($³ß´â’¤[$’Ó•ãÛÍ[1250]] . $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[1243]]); $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[560]] = $³ß´â’¤; $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[1225]] = $Àé«ÁÄ€; $Î¡˜óúí = array($’Ó•ãÛÍ[1245] => $’Ó•ãÛÍ[1253], $’Ó•ãÛÍ[6] => $éÛ÷Ÿ·ï); } else { if (!$Àé«ÁÄ€) { $Àé«ÁÄ€ = $³ß´â’¤[$’Ó•ãÛÍ[193]]; } } break; default: $Àé«ÁÄ€ = $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[87]]; $Î¡˜óúí = array($’Ó•ãÛÍ[1245] => $’Ó•ãÛÍ[1254]); break; } $®şó‚¬ = $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[87]]; if (!isset(self::$driverCache[$®şó‚¬])) { $¶æƒîŠŞ = strtolower($Î¡˜óúí[$’Ó•ãÛÍ[98]]); $×üÜ¨ö = $GLOBALS[$’Ó•ãÛÍ[6]][$’Ó•ãÛÍ[92]][$’Ó•ãÛÍ[891]]; $Ç®—¥Ì = $’Ó•ãÛÍ[77] . (isset($×üÜ¨ö[$¶æƒîŠŞ]) ? $×üÜ¨ö[$¶æƒîŠŞ] : ucfirst($¶æƒîŠŞ)); if (!class_exists($Ç®—¥Ì)) { show_json("{$Ç®—¥Ì}\x20\156\157\x74\x20\145\170\x69\163\x74\x73\x21", !1); } $ãÉËÈ¡¡ = isset($Î¡˜óúí[$’Ó•ãÛÍ[6]]) ? $Î¡˜óúí[$’Ó•ãÛÍ[6]] : !1; self::$driverCache[$®şó‚¬] = new $Ç®—¥Ì($ãÉËÈ¡¡); } $«Òè = self::$driverCache[$®şó‚¬]; $«Òè->pathDriver = $´’é…«à; $«Òè->pathBase = $’Ó•ãÛÍ[12]; if (isset($Î¡˜óúí[$’Ó•ãÛÍ[6]][$’Ó•ãÛÍ[1255]])) { $«Òè->pathBase = rtrim($Î¡˜óúí[$’Ó•ãÛÍ[6]][$’Ó•ãÛÍ[1255]], $’Ó•ãÛÍ[8]) . $’Ó•ãÛÍ[8]; $Àé«ÁÄ€ = $«Òè->pathBase . ltrim($Àé«ÁÄ€, $’Ó•ãÛÍ[8]); } $Àé«ÁÄ€ = $«Òè->getPath($Àé«ÁÄ€); if (isset($éÛ÷Ÿ·ï[$’Ó•ãÛÍ[1225]])) { $Àé«ÁÄ€ = $éÛ÷Ÿ·ï[$’Ó•ãÛÍ[1225]]; } $«Òè->path = $Àé«ÁÄ€; return $«Òè; } public static function errorTips($ä–Ö²ßú = false) { $ĞíÏÔª =& $_SERVER[ÆªÈ–¬]; static $¾ø¤¨„ = array(); $ÕÉ­ôõã = 1000; if ($ä–Ö²ßú === -1) { return $¾ø¤¨„ ? $¾ø¤¨„[count($¾ø¤¨„) - 1] : $ĞíÏÔª[12]; } if ($ä–Ö²ßú === !1) { return implode($ĞíÏÔª[262], $¾ø¤¨„); } if (count($¾ø¤¨„) >= $ÕÉ­ôõã) { $¾ø¤¨„ = array_slice($¾ø¤¨„, $ÕÉ­ôõã * 0.5, $ÕÉ­ôõã); } $¾ø¤¨„[] = $ä–Ö²ßú; write_log($ĞíÏÔª[176] . ACTION . $ĞíÏÔª[1256] . $ä–Ö²ßú, $ĞíÏÔª[1257]); } public static function getLastError($íìı×Ú = '') { $â¹ÉòÀ˜ = self::errorTips(-1); return $â¹ÉòÀ˜ ? $â¹ÉòÀ˜ : $íìı×Ú; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ÚÙ“¡¶; if ($ÚÙ“¡¶) { return $ÚÙ“¡¶; } $—©óƒÄ• = IO::init($_SERVER[ÆªÈ–¬][8]); return $—©óƒÄ•; } private static function iconvSystem($ş½îŞœì) { return self::local()->iconvSystem($ş½îŞœì); } private static function iconvApp($”áªÚ·Æ) { return self::local()->iconvApp($”áªÚ·Æ); } public static function zipFolder($´ƒ¬—å, $Œ²Šš‹„ = "\x7a\x69\160", $Ò¬ıºÁö = '', $ùÏ­©ÅÎ = REPEAT_RENAME) { $È™„áä¯ =& $_SERVER[ÆªÈ–¬]; $û›Ì®ğµ = IO::listPath($´ƒ¬—å); if (!$û›Ì®ğµ) { return !1; } $û›Ì®ğµ = array_merge($û›Ì®ğµ[$È™„áä¯[85]], $û›Ì®ğµ[$È™„áä¯[86]]); return self::zip($û›Ì®ğµ, $Œ²Šš‹„, $Ò¬ıºÁö, $ùÏ­©ÅÎ); } public static function zip($ÆÄõÉ­, $Ô±åäï‰ = "\172\151\160", $‚¹€ÖìÄ = '', $ÈìÕ‰¦ = REPEAT_RENAME) { $Ş›ğÔµ =& $_SERVER[ÆªÈ–¬]; if (is_string($ÆÄõÉ­) && $ÆÄõÉ­) { $ÆÄõÉ­ = array(array($Ş›ğÔµ[87] => $ÆÄõÉ­)); } $óÎ¡£«ö = self::init($ÆÄõÉ­[0][$Ş›ğÔµ[87]]); $æİ‡Òã‚ = self::info($ÆÄõÉ­[0][$Ş›ğÔµ[87]]); $Ï°ì½ëÏ = $Ş›ğÔµ[12]; $¬²õÀµ¤ = $Ş›ğÔµ[12]; $¸ı¾Ô¶Â = $Ş›ğÔµ[12]; if ($‚¹€ÖìÄ && substr($‚¹€ÖìÄ, -1, 1) != $Ş›ğÔµ[8]) { $¬²õÀµ¤ = get_path_father($‚¹€ÖìÄ); $¸ı¾Ô¶Â = get_path_this($‚¹€ÖìÄ); } else { $¬²õÀµ¤ = self::pathFather($æİ‡Òã‚[$Ş›ğÔµ[87]]); $¸ı¾Ô¶Â = $æİ‡Òã‚[$Ş›ğÔµ[32]] . $Ş›ğÔµ[10] . $Ô±åäï‰; if (count($ÆÄõÉ­) > 1) { $“Ñş²·Ï = IO::info($¬²õÀµ¤); $¸ı¾Ô¶Â = $“Ñş²·Ï[$Ş›ğÔµ[32]] . $Ş›ğÔµ[10] . $Ô±åäï‰; } if ($‚¹€ÖìÄ) { $¬²õÀµ¤ = $‚¹€ÖìÄ; } } if ($óÎ¡£«ö->getType() == $Ş›ğÔµ[109]) { $˜şµµ­Á = self::init($¬²õÀµ¤); $—®­ø„ = $˜şµµ­Á->getType() == $Ş›ğÔµ[109] ? $¬²õÀµ¤ : get_path_father($óÎ¡£«ö->path); $—®­ø„ = rtrim($—®­ø„, $Ş›ğÔµ[8]) . $Ş›ğÔµ[8]; mk_dir($—®­ø„); } else { $Ï°ì½ëÏ = TEMP_FILES . $Ş›ğÔµ[1258] . time() . rand_string(8) . $Ş›ğÔµ[8]; mk_dir($Ï°ì½ëÏ); file_put_contents($Ï°ì½ëÏ . $Ş›ğÔµ[1259], $Ş›ğÔµ[12]); $—®­ø„ = $Ï°ì½ëÏ; } $È…İ«ÕÏ = IO::info($—®­ø„); if (!$È…İ«ÕÏ || !$È…İ«ÕÏ[$Ş›ğÔµ[233]]) { show_json(LNG($Ş›ğÔµ[1260]), !1); } $·Ëú›Ñ£ = self::zipFileList($ÆÄõÉ­, $Ï°ì½ëÏ); foreach ($·Ëú›Ñ£ as $¥á¾Äœ§ => $²­ÂÃ‘ó) { $·Ëú›Ñ£[$¥á¾Äœ§] = self::iconvSystem($²­ÂÃ‘ó); } $ÓÊÅª¶à = get_filename_auto($—®­ø„ . $¸ı¾Ô¶Â, $Ş›ğÔµ[12], $ÈìÕ‰¦); KodArchive::create(self::iconvSystem($ÓÊÅª¶à), $·Ëú›Ñ£); if (!IO::exist($ÓÊÅª¶à)) { if ($Ï°ì½ëÏ) { del_dir($Ï°ì½ëÏ); } write_log($Ş›ğÔµ[1261] . $ÓÊÅª¶à, $Ş›ğÔµ[389]); show_json(LNG($Ş›ğÔµ[1262]), !1); } if (!$Ï°ì½ëÏ) { return $ÓÊÅª¶à; } $ó”ˆû”İ = self::move($ÓÊÅª¶à, $¬²õÀµ¤, $ÈìÕ‰¦); if ($Ï°ì½ëÏ) { del_dir($Ï°ì½ëÏ); } if (!$ÓÊÅª¶à) { write_log($Ş›ğÔµ[1263] . $ÓÊÅª¶à . $Ş›ğÔµ[1264] . $¬²õÀµ¤, $Ş›ğÔµ[389]); show_json(LNG($Ş›ğÔµ[1262]), !1); } return $ó”ˆû”İ; } public static function unzip($·»Ôô¾, $Ïˆ­‹øï, $ß›È´Ò = "\55\61", $Û±ÅÍâ¡ = "\162\145\160\x6c\x61\143\145") { $ï‚›²—Ï =& $_SERVER[ÆªÈ–¬]; $¿×É¾ã› = parent::info($·»Ôô¾); if (!$¿×É¾ã›) { show_json(LNG($ï‚›²—Ï[1265]), !1); } $õ‚„ŸüĞ = IO::infoFullSimple($Ïˆ­‹øï); if (!$õ‚„ŸüĞ) { $Ïˆ­‹øï = IO::mkdir($Ïˆ­‹øï); } if (isset($õ‚„ŸüĞ[$ï‚›²—Ï[193]]) && trim($õ‚„ŸüĞ[$ï‚›²—Ï[87]], $ï‚›²—Ï[8]) != trim($Ïˆ­‹øï, $ï‚›²—Ï[8])) { $¥êú»¥ë = KodIO::make($õ‚„ŸüĞ[$ï‚›²—Ï[192]]); $ŠõÚÖ·Ù = IO::fileNameAuto($¥êú»¥ë, $õ‚„ŸüĞ[$ï‚›²—Ï[32]], REPEAT_RENAME_FOLDER, !0); $Ïˆ­‹øï = IO::mkdir($¥êú»¥ë . $ŠõÚÖ·Ù); } $ß›È´Ò = $ß›È´Ò && $ß›È´Ò != $ï‚›²—Ï[1266] ? @json_decode($ß›È´Ò, !0) : -1; $³œË˜õ = self::unzipPart($·»Ôô¾, $ß›È´Ò); if (!$³œË˜õ || !IO::exist($³œË˜õ[$ï‚›²—Ï[230]])) { show_json(LNG($ï‚›²—Ï[108]), !1); } $õòú üÌ = $³œË˜õ[$ï‚›²—Ï[1267]][count($³œË˜õ[$ï‚›²—Ï[1267]]) - 1]; if ($õòú üÌ[$ï‚›²—Ï[1268]] == -1 || substr($õòú üÌ[$ï‚›²—Ï[32]], -1, 1) == $ï‚›²—Ï[8]) { $û¶Óí‰ = $³œË˜õ[$ï‚›²—Ï[1269]] . rand_string(10) . $ï‚›²—Ï[8]; mk_dir($û¶Óí‰); $âä‡‘Ä” = count($³œË˜õ[$ï‚›²—Ï[1267]]) == 1 ? IO::ext($·»Ôô¾) : get_path_ext($³œË˜õ[$ï‚›²—Ï[230]]); $Ú´Œ’ ¦ = KodArchive::extract(self::iconvSystem($³œË˜õ[$ï‚›²—Ï[230]]), $û¶Óí‰, $õòú üÌ[$ï‚›²—Ï[1268]], $ŠõÚÖ·Ù, $âä‡‘Ä”); self::unzipErrorCheck($Ú´Œ’ ¦, array($ï‚›²—Ï[1270], $·»Ôô¾, $âä‡‘Ä”, $Ïˆ­‹øï, $³œË˜õ)); Hook::trigger($ï‚›²—Ï[1271], $û¶Óí‰); recursion_dir($û¶Óí‰, $÷¬ïºÊº, $š¥Ûªù§, 0); $ˆ–Ğ¿ùö = array_merge($÷¬ïºÊº, $š¥Ûªù§); $Ñ‡¼‚ÚÁ = array(); foreach ($ˆ–Ğ¿ùö as $ Æ‚Ü“¸) { $ºÒñ„æ = IO::move(self::iconvApp($ Æ‚Ü“¸), $Ïˆ­‹øï, $Û±ÅÍâ¡); if ($ºÒñ„æ) { $Ñ‡¼‚ÚÁ[] = $ºÒñ„æ; } } del_dir($û¶Óí‰); } else { $ºÒñ„æ = IO::move($³œË˜õ[$ï‚›²—Ï[230]], $Ïˆ­‹øï, $Û±ÅÍâ¡, get_path_this($õòú üÌ[$ï‚›²—Ï[32]])); if ($ºÒñ„æ) { $Ñ‡¼‚ÚÁ[] = $ºÒñ„æ; } } return $Ñ‡¼‚ÚÁ ? $Ñ‡¼‚ÚÁ : !1; } public static function unzipList($»İÃ×ĞÁ) { $˜°±áÙ‚ =& $_SERVER[ÆªÈ–¬]; $µÍÎ¼Àõ = isset($»İÃ×ĞÁ[$˜°±áÙ‚[1272]]) ? $»İÃ×ĞÁ[$˜°±áÙ‚[1272]] : !1; $Ü„ö÷ı§ = isset($»İÃ×ĞÁ[$˜°±áÙ‚[1268]]) ? @json_decode($»İÃ×ĞÁ[$˜°±áÙ‚[1268]], !0) : -1; $éõ¢«÷µ = self::unzipPart($»İÃ×ĞÁ[$˜°±áÙ‚[87]], $Ü„ö÷ı§); if (!$éõ¢«÷µ || !IO::exist($éõ¢«÷µ[$˜°±áÙ‚[230]])) { show_json(LNG($˜°±áÙ‚[108]), !1); } $ç‡ç«î¯ = $éõ¢«÷µ[$˜°±áÙ‚[1267]][count($éõ¢«÷µ[$˜°±áÙ‚[1267]]) - 1]; $Æ¡—ùÅŒ = in_array(IO::ext($éõ¢«÷µ[$˜°±áÙ‚[230]]), array($˜°±áÙ‚[389], $˜°±áÙ‚[1273], $˜°±áÙ‚[1274], $˜°±áÙ‚[1275], $˜°±áÙ‚[1276], $˜°±áÙ‚[1277])); if (!$µÍÎ¼Àõ && ($ç‡ç«î¯[$˜°±áÙ‚[1268]] == -1 || $Æ¡—ùÅŒ)) { $¼“Ğ¿¥ã = $éõ¢«÷µ[$˜°±áÙ‚[1269]] . get_path_this($éõ¢«÷µ[$˜°±áÙ‚[230]]) . $˜°±áÙ‚[1278]; if (!IO::exist($¼“Ğ¿¥ã)) { $ŞÌ„–óÕ = $ç‡ç«î¯[$˜°±áÙ‚[1268]] == -1 ? get_path_ext(IO::pathThis($»İÃ×ĞÁ[$˜°±áÙ‚[87]])) : get_path_ext($éõ¢«÷µ[$˜°±áÙ‚[230]]); $°ï¶©®± = KodArchive::listContent(self::iconvSystem($éõ¢«÷µ[$˜°±áÙ‚[230]]), !0, $ŞÌ„–óÕ); self::unzipErrorCheck($°ï¶©®±, array($˜°±áÙ‚[1279], $»İÃ×ĞÁ, $éõ¢«÷µ)); @file_put_contents($¼“Ğ¿¥ã, json_encode($°ï¶©®±[$˜°±áÙ‚[1280]])); } return @json_decode(IO::getContent($¼“Ğ¿¥ã), !0); } IO::fileOut($éõ¢«÷µ[$˜°±áÙ‚[230]], $µÍÎ¼Àõ, get_path_this($ç‡ç«î¯[$˜°±áÙ‚[32]])); die; } private static function zipFileList($ƒú…Ù, $úØ™ñÊ¼ = false) { $¶ºÔàø„ =& $_SERVER[ÆªÈ–¬]; $î• ‚èü = array(); foreach ($ƒú…Ù as $ÂÛñà·ô) { $ËıÕ¿êˆ = $ÂÛñà·ô[$¶ºÔàø„[87]]; if ($úØ™ñÊ¼) { $ËıÕ¿êˆ = self::copy($ÂÛñà·ô[$¶ºÔàø„[87]], $úØ™ñÊ¼, $¶ºÔàø„[884]); } else { $ÜÏª½şì = self::init($ÂÛñà·ô[$¶ºÔàø„[87]]); if ($ÜÏª½şì->getType() == $¶ºÔàø„[109]) { $ËıÕ¿êˆ = $ÜÏª½şì->path; } } if ($ËıÕ¿êˆ && self::local()->exist($ËıÕ¿êˆ)) { $î• ‚èü[$ÂÛñà·ô[$¶ºÔàø„[87]]] = $ËıÕ¿êˆ; } } if (!empty($î• ‚èü)) { return array_values($î• ‚èü); } show_json(LNG($¶ºÔàø„[1239]), !1); } private static function localFilePath($¢¦ÊÜİ¨) { $ªç¬·°û =& $_SERVER[ÆªÈ–¬]; $”ÜŒ±‘Ó = KodIO::parse($¢¦ÊÜİ¨); if ($”ÜŒ±‘Ó[$ªç¬·°û[33]] == KodIO::KOD_SOURCE) { $è¨şÙ = Model($ªç¬·°û[890])->fileInfoGet(KodIO::sourceID($¢¦ÊÜİ¨)); if (!$è¨şÙ[$ªç¬·°û[87]]) { show_json($ªç¬·°û[1281], !1); } $¢¦ÊÜİ¨ = $è¨şÙ[$ªç¬·°û[87]]; } $ŞñÊ©ÁÊ = self::init($¢¦ÊÜİ¨); if ($ŞñÊ©ÁÊ->pathParse[$ªç¬·°û[1225]]) { $¢¦ÊÜİ¨ = $ŞñÊ©ÁÊ->pathParse[$ªç¬·°û[1225]]; $ŞñÊ©ÁÊ = self::init($¢¦ÊÜİ¨); } $â…‘¾„û = $ŞñÊ©ÁÊ->getType(); if ($â…‘¾„û == $ªç¬·°û[109] || $â…‘¾„û == $ªç¬·°û[1282]) { if (!$ŞñÊ©ÁÊ->exist($ŞñÊ©ÁÊ->path)) { show_json(LNG($ªç¬·°û[108]), !1); } return $ŞñÊ©ÁÊ->path; } return !1; } public static function unzipPart($µüŞÏë…, $´ĞØÄî† = -1) { $–ì™Äµ· =& $_SERVER[ÆªÈ–¬]; $ÓşˆòÈÃ = IO::pathThis($µüŞÏë…); if (!$´ĞØÄî† || $´ĞØÄî† == -1) { $ò… ²úã = array(array($–ì™Äµ·[32] => $ÓşˆòÈÃ, $–ì™Äµ·[1268] => -1)); $ò… ²úã[0][$–ì™Äµ·[1283]] = $ò… ²úã[0][$–ì™Äµ·[32]]; } else { if (is_array($´ĞØÄî†)) { $ò… ²úã = $´ĞØÄî†; $Âáı›ú = count($ò… ²úã) - 1; for ($­ ¾Ğ´ = 0; $­ ¾Ğ´ <= $Âáı›ú; $­ ¾Ğ´++) { $ÑĞàšÑ® = $ò… ²úã[$­ ¾Ğ´]; $æœ·Ò¤ì = get_path_this($ÑĞàšÑ®[$–ì™Äµ·[32]]) . (checkExtSafe($ÑĞàšÑ®[$–ì™Äµ·[32]]) ? $–ì™Äµ·[12] : $–ì™Äµ·[1284]); $ò… ²úã[$­ ¾Ğ´][$–ì™Äµ·[1283]] = $–ì™Äµ·[1285] . intval($ÑĞàšÑ®[$–ì™Äµ·[1268]]) . $–ì™Äµ·[462] . $æœ·Ò¤ì; if ($­ ¾Ğ´ == 0) { continue; } $ò… ²úã[$­ ¾Ğ´][$–ì™Äµ·[1283]] = $ò… ²úã[$­ ¾Ğ´ - 1][$–ì™Äµ·[1283]] . $–ì™Äµ·[1286] . $ò… ²úã[$­ ¾Ğ´][$–ì™Äµ·[1283]]; } } } if (!is_array($ò… ²úã) || count($ò… ²úã) == 0) { return !1; } $°õ¦ êœ = $ò… ²úã[count($ò… ²úã) - 1]; if (!IO::exist($µüŞÏë…)) { return !1; } $–¼¶¯˜Ê = TEMP_FILES . $–ì™Äµ·[1287] . kodIO::hashPathSafe($µüŞÏë…) . $–ì™Äµ·[8]; $È™èõÖ§ = $–¼¶¯˜Ê . $°õ¦ êœ[$–ì™Äµ·[1283]]; mk_dir($–¼¶¯˜Ê); file_put_contents(TEMP_FILES . $–ì™Äµ·[1259], $–ì™Äµ·[12]); if (IO::exist($È™èõÖ§)) { return array($–ì™Äµ·[230] => $È™èõÖ§, $–ì™Äµ·[1267] => $ò… ²úã, $–ì™Äµ·[1269] => $–¼¶¯˜Ê); } $ëú¨î÷ª = self::localFilePath($µüŞÏë…); if (!$ëú¨î÷ª) { $ëú¨î÷ª = $–¼¶¯˜Ê . $–ì™Äµ·[1288]; if (!IO::exist($ëú¨î÷ª)) { self::copy($µüŞÏë…, $–¼¶¯˜Ê, !1, get_path_this($ëú¨î÷ª)); } } if (!$ëú¨î÷ª || !IO::exist($ëú¨î÷ª)) { return !1; } if ($°õ¦ êœ[$–ì™Äµ·[1268]] == -1) { return array($–ì™Äµ·[230] => $ëú¨î÷ª, $–ì™Äµ·[1267] => $ò… ²úã, $–ì™Äµ·[1269] => $–¼¶¯˜Ê); } $ĞÇç±Êˆ = $ëú¨î÷ª; foreach ($ò… ²úã as $­ ¾Ğ´ => $ÑĞàšÑ®) { if (!$ÑĞàšÑ® || $ÑĞàšÑ®[$–ì™Äµ·[1268]] == $–ì™Äµ·[1266]) { break; } if (substr($ÑĞàšÑ®[$–ì™Äµ·[32]], -1, 1) == $–ì™Äµ·[8]) { break; } $Ì‘€²…« = in_array(get_path_ext($ÑĞàšÑ®[$–ì™Äµ·[1283]]), array($–ì™Äµ·[389], $–ì™Äµ·[1273], $–ì™Äµ·[1274], $–ì™Äµ·[1275], $–ì™Äµ·[1276], $–ì™Äµ·[1277])); $¼ĞÇÑÎ¦ = $­ ¾Ğ´ == count($ò… ²úã) - 1 && $Ì‘€²…«; $œø½ş­” = $–¼¶¯˜Ê . $ÑĞàšÑ®[$–ì™Äµ·[1283]]; $ÇâŠ×«º = $–¼¶¯˜Ê . get_path_this($ÑĞàšÑ®[$–ì™Äµ·[32]]); if (IO::exist($œø½ş­”)) { $ĞÇç±Êˆ = $œø½ş­”; continue; } $ĞÓû ¦Ô = $­ ¾Ğ´ == 0 ? get_path_ext($ÓşˆòÈÃ) : get_path_ext($ĞÇç±Êˆ); $Â‡ñ°Î³ = KodArchive::extract(self::iconvSystem($ĞÇç±Êˆ), $–¼¶¯˜Ê, $ÑĞàšÑ®[$–ì™Äµ·[1268]], $„»¦´Ë…, $ĞÓû ¦Ô); self::unzipErrorCheck($Â‡ñ°Î³, array($–ì™Äµ·[1289], $µüŞÏë…, $ò… ²úã, $ÑĞàšÑ®, $œø½ş­”)); if (IO::exist($ÇâŠ×«º)) { IO::rename($ÇâŠ×«º, get_path_this($œø½ş­”)); } $ĞÇç±Êˆ = $œø½ş­”; } $È™èõÖ§ = $ĞÇç±Êˆ; return array($–ì™Äµ·[230] => $ĞÇç±Êˆ, $–ì™Äµ·[1267] => $ò… ²úã, $–ì™Äµ·[1269] => $–¼¶¯˜Ê); } private static function unzipErrorCheck($ŒûÛ™ó—, $¢›şİ¡š = false) { $„ê™‡ª =& $_SERVER[ÆªÈ–¬]; if ($ŒûÛ™ó—[$„ê™‡ª[1290]]) { return !0; } write_log(array($„ê™‡ª[1291], $ŒûÛ™ó—, $¢›şİ¡š), $„ê™‡ª[1292]); show_json($„ê™‡ª[1293] . json_encode($ŒûÛ™ó—[$„ê™‡ª[1280]]), !1); die; } } goto FÈ÷äÚèİÃ; cÖƒà›Œôµ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÍÈğ­èŞ =& $_SERVER[ÆªÈ–¬]; if (self::$handle) { return self::$handle; } $å¡©ú±º = $GLOBALS[$ÍÈğ­èŞ[6]][$ÍÈğ­èŞ[425]]; self::$timeout = $å¡©ú±º[$ÍÈğ­èŞ[914]] ? $å¡©ú±º[$ÍÈğ­èŞ[914]] : 10; $¾—ÆãÂ‚ = _get($GLOBALS[$ÍÈğ­èŞ[6]], $ÍÈğ­èŞ[915]); $©¹‡êç´ = $å¡©ú±º[$ÍÈğ­èŞ[900]] ? $å¡©ú±º[$ÍÈğ­èŞ[900]] : $ÍÈğ­èŞ[230]; if ($©¹‡êç´ == $ÍÈğ­èŞ[21] && $¾—ÆãÂ‚ == $ÍÈğ­èŞ[13]) { $©¹‡êç´ = $ÍÈğ­èŞ[230]; } switch ($©¹‡êç´) { case $ÍÈğ­èŞ[903]: self::$handle = new CacheLockRedis(); break; case $ÍÈğ­èŞ[904]: self::$handle = new CacheLockMemcached(); break; case $ÍÈğ­èŞ[21]: self::$handle = new CacheLockDatabase(); break; case $ÍÈğ­èŞ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÍÈğ­èŞ[916], $ÍÈğ­èŞ[917]); } return self::$handle; } private static function key($Å¦•ŒÙş) { return $_SERVER[ÆªÈ–¬][918] . Cache::key($Å¦•ŒÙş); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ãŠØæÛ = '') { self::$errorMsg = $ãŠØæÛ; } public static function lockGlobal($ª¡ …úÅ, $ÀÖ€İ·˜) { return self::lock($ª¡ …úÅ, $ÀÖ€İ·˜, !0); } public static function lock($€•û±Š, $Øìá¿Ÿû = false, $øŠ¯«±» = false) { $¿ØÛÂ–Ò =& $_SERVER[ÆªÈ–¬]; $–¥ŠŠ±Ø = self::init(); $–¸üñº­ = self::key($€•û±Š); $Øìá¿Ÿû = $Øìá¿Ÿû ? $Øìá¿Ÿû : self::$timeout; $Ïò«ëç² = timeFloat(); $í”ıŒê¤ = $–¥ŠŠ±Ø->lock($–¸üñº­, $Øìá¿Ÿû); $ªåŒè× = timeFloat(); if (!$í”ıŒê¤) { $¸Äú†¥È = "\154\x6f\143\x6b\x20\x65\x72\162\x6f\x72\x3b\153\145\x79\75{$€•û±Š}\x3b\x74\x69\x6d\x65\x3d{$Øìá¿Ÿû}\73" . self::$errorMsg . $¿ØÛÂ–Ò[74] . get_caller_msg(); $«ıôó­‘ = LNG($¿ØÛÂ–Ò[919]) . "\50{$Øìá¿Ÿû}\163\51\x2e" . LNG($¿ØÛÂ–Ò[920]); $«ıôó­‘ .= $¿ØÛÂ–Ò[921]; if (is_string(self::$errorMsg) && self::$errorMsg) { $«ıôó­‘ = $«ıôó­‘ . $¿ØÛÂ–Ò[922] . self::$errorMsg; } write_log($¿ØÛÂ–Ò[923] . sprintf($¿ØÛÂ–Ò[924], timeFloat() - $Ïò«ëç²) . $¿ØÛÂ–Ò[925] . $¸Äú†¥È . $¿ØÛÂ–Ò[926] . error_get_last(), $¿ØÛÂ–Ò[917]); show_json($«ıôó­‘, !1); } if (!$øŠ¯«±») { self::$lockItem[$–¸üñº­] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Çºˆ•ä = number_format(timeFloat() - $ªåŒè×, 3); write_log($¿ØÛÂ–Ò[927] . $€•û±Š . $¿ØÛÂ–Ò[928] . $Çºˆ•ä, $¿ØÛÂ–Ò[917]); } return $í”ıŒê¤; } public static function lockGet($æµÆÀ¦Ï) { $ûúäãøÈ = self::key($æµÆÀ¦Ï); if (self::$lockItem[$ûúäãøÈ]) { return self::$lockItem[$ûúäãøÈ]; } return self::init()->lockGet($ûúäãøÈ); } public static function unlock($¦¸‹˜é¼) { $Êº°Ò§ =& $_SERVER[ÆªÈ–¬]; $Ù¢‡çš = self::key($¦¸‹˜é¼); self::$lockItem[$Ù¢‡çš] = null; self::init()->unlock($Ù¢‡çš); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Êº°Ò§[929] . $¦¸‹˜é¼, $Êº°Ò§[917]); } return; } public static function unlockRuntime() { $·¨‘ƒã¼ =& $_SERVER[ÆªÈ–¬]; $œüŞªÈ™ = self::init(); $ãÑ—‹‰ñ = !1; foreach (self::$lockItem as $Ñ™´´‡² => $‰í£×äÌ) { if (!$‰í£×äÌ) { continue; } $œüŞªÈ™->unlock($Ñ™´´‡²); if (!$ãÑ—‹‰ñ) { $ãÑ—‹‰ñ = !0; write_log($·¨‘ƒã¼[930] . $Ñ™´´‡² . $·¨‘ƒã¼[74] . get_caller_msg(), $·¨‘ƒã¼[917]); continue; } write_log($·¨‘ƒã¼[930] . $Ñ™´´‡², $·¨‘ƒã¼[917]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $—¥Ò¨Êè = number_format(timeFloat() - TIME_FLOAT, 3); write_log($·¨‘ƒã¼[931] . $—¥Ò¨Êè . $·¨‘ƒã¼[932] . ACTION, $·¨‘ƒã¼[917]); } } public static function fileLock($â¤¯”å¼) { $ò×Ë ¦İ =& $_SERVER[ÆªÈ–¬]; if (!$GLOBALS[$ò×Ë ¦İ[933]]) { $GLOBALS[$ò×Ë ¦İ[933]] = array(); } $GLOBALS[$ò×Ë ¦İ[933]][$â¤¯”å¼] = !1; $Æúµ‚€œ = fopen(DATA_PATH . $â¤¯”å¼ . $ò×Ë ¦İ[934], $ò×Ë ¦İ[935]); if (!$Æúµ‚€œ) { return !1; } $GLOBALS[$ò×Ë ¦İ[933]][$â¤¯”å¼] = $Æúµ‚€œ; if (flock($Æúµ‚€œ, LOCK_EX)) { return !0; } self::unlock($â¤¯”å¼); show_json($ò×Ë ¦İ[936], !1); return !1; } public static function fileUnlock($£ƒå…÷†) { $Åš„á¢İ =& $_SERVER[ÆªÈ–¬]; $í†ƒ„÷ş = $GLOBALS[$Åš„á¢İ[933]][$£ƒå…÷†]; if (!$í†ƒ„÷ş) { return; } $GLOBALS[$Åš„á¢İ[933]][$£ƒå…÷†] = !1; flock($í†ƒ„÷ş, LOCK_UN); fclose($í†ƒ„÷ş); } public static function fileUnlockAll() { $¡äŒß˜ =& $_SERVER[ÆªÈ–¬]; if (!isset($GLOBALS[$¡äŒß˜[933]]) || !$GLOBALS[$¡äŒß˜[933]]) { return; } foreach ($GLOBALS[$¡äŒß˜[933]] as $‡ìì×ÀÌ => $öüë¨Ÿú) { if (!$öüë¨Ÿú) { continue; } $GLOBALS[$¡äŒß˜[933]][$‡ìì×ÀÌ] = !1; flock($öüë¨Ÿú, LOCK_UN); fclose($öüë¨Ÿú); } $GLOBALS[$¡äŒß˜[933]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ëÔæ´…å =& $_SERVER[ÆªÈ–¬]; $“Ÿµìåè = $GLOBALS[$ëÔæ´…å[6]][$ëÔæ´…å[425]]; self::$cachePath = $“Ÿµìåè[$ëÔæ´…å[230]][$ëÔæ´…å[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ı’÷ôº“, $ÀÕø‘ = 0) { $¸şÅ»œé =& $_SERVER[ÆªÈ–¬]; $Èš¾œÏİ = microtime(!0); $Õ‡„€ = $Èš¾œÏİ + $ÀÕø‘ + 0.0001; $»š€ˆã = rtrim(self::$cachePath, $¸şÅ»œé[8]) . $¸şÅ»œé[937] . md5($ı’÷ôº“) . $¸şÅ»œé[934]; if (file_exists($»š€ˆã) && filemtime($»š€ˆã) && filemtime($»š€ˆã) < time() - 10) { @unlink($»š€ˆã); } do { if (file_exists($»š€ˆã)) { cacheLockWait(); continue; } $¦ÀÒÔöÈ = fopen($»š€ˆã, $¸şÅ»œé[938]); if (!$¦ÀÒÔöÈ) { return !1; } $µÅÏÜœ = flock($¦ÀÒÔöÈ, LOCK_EX | LOCK_NB); self::$caches[$ı’÷ôº“] = array($¸şÅ»œé[939] => $¦ÀÒÔöÈ, $¸şÅ»œé[230] => $»š€ˆã); fwrite($¦ÀÒÔöÈ, $Õ‡„€); clearstatcache(); if ($¦ÀÒÔöÈ && $µÅÏÜœ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Õ‡„€); $this->unlock($ı’÷ôº“); return !1; } public function lockGet($Ãƒ²„Şµ) { $òà‚¶Ï’ =& $_SERVER[ÆªÈ–¬]; $‚ĞÍ´àƒ = rtrim(self::$cachePath, $òà‚¶Ï’[8]) . $òà‚¶Ï’[937] . md5($Ãƒ²„Şµ) . $òà‚¶Ï’[934]; return file_exists($‚ĞÍ´àƒ); } public function unlock($ˆö›……ƒ) { $½éö¸Çş =& $_SERVER[ÆªÈ–¬]; $»Îèéåº = self::$caches[$ˆö›……ƒ]; if (!$»Îèéåº) { return; } @flock($»Îèéåº[$½éö¸Çş[939]], LOCK_UN); @fclose($»Îèéåº[$½éö¸Çş[939]]); @unlink($»Îèéåº[$½éö¸Çş[230]]); unset(self::$caches[$ˆö›……ƒ]); } } goto c«­œî¬¹©; DÖ”°×‹Æ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ñŒ×€ö =& $_SERVER[ÆªÈ–¬]; if (self::valueGet($ñŒ×€ö[816]) != $ñŒ×€ö[91]) { return; } if (self::valueGet($ñŒ×€ö[1715]) == $ñŒ×€ö[91]) { $ˆÌÈÁ†” = self::valueGet($ñŒ×€ö[1716]); if (time() - $ˆÌÈÁ†” > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ñŒ×€ö[1715], $ñŒ×€ö[91]); self::log($ñŒ×€ö[1717] . ACTION . $ñŒ×€ö[1718]); Hook::bind($ñŒ×€ö[1719], $ñŒ×€ö[1720]); $İÛôëóŠ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ñŒ×€ö[816]) != $ñŒ×€ö[91]) { self::valueSet($ñŒ×€ö[1715], $ñŒ×€ö[228]); self::log($ñŒ×€ö[1721]); die; } $ı¨ğ÷À¯ = time(); if ($ı¨ğ÷À¯ - $İÛôëóŠ >= 60) { self::valueSet(array($ñŒ×€ö[1715] => $ñŒ×€ö[91], $ñŒ×€ö[1716] => $ı¨ğ÷À¯)); $İÛôëóŠ = $ı¨ğ÷À¯; } if (!file_exists(USER_SYSTEM . $ñŒ×€ö[1722])) { self::valueSet(array($ñŒ×€ö[1715] => $ñŒ×€ö[228], $ñŒ×€ö[816] => $ñŒ×€ö[228])); self::log($ñŒ×€ö[1723]); die; } $àáòùÁ¦ = file_get_contents(BASIC_PATH . $ñŒ×€ö[1724]); $…ÑÆğÊó = KOD_VERSION . $ñŒ×€ö[10] . KOD_VERSION_BUILD; $÷¨™ôµ = match_text($àáòùÁ¦, $ñŒ×€ö[1725]) . $ñŒ×€ö[10] . match_text($àáòùÁ¦, $ñŒ×€ö[1726]); if ($÷¨™ôµ != $…ÑÆğÊó) { self::restart(); self::log("\163\164\157\160\x65\x64\x2e\133\x76\145\162\x73\151\x6f\x6e\x20\x75\160\144\141\x74\x65\73{$versionNow}\x20\75\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ò™•ó¯Ñ =& $_SERVER[ÆªÈ–¬]; http_close(); $GLOBALS[$ò™•ó¯Ñ[1727]] = 1; $_SERVER[$ò™•ó¯Ñ[1728]] = $ò™•ó¯Ñ[1729]; $_COOKIE = array(); $GLOBALS[$ò™•ó¯Ñ[1730]] = 1; $GLOBALS[$ò™•ó¯Ñ[1731]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $äÉíÊË– =& $_SERVER[ÆªÈ–¬]; http_close(); self::valueSet($äÉíÊË–[816], $äÉíÊË–[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($äÉíÊË–[1715] => $äÉíÊË–[228], $äÉíÊË–[816] => $äÉíÊË–[91])); self::log($äÉíÊË–[1732]); } public static function taskSwitch() { $å·Ç¯¹— =& $_SERVER[ÆªÈ–¬]; $‘›êØ = self::valueGet($å·Ç¯¹—[816]) == $å·Ç¯¹—[91] ? $å·Ç¯¹—[228] : $å·Ç¯¹—[91]; self::valueSet($å·Ç¯¹—[816], $‘›êØ); } public static function shutdownEvent() { $ïÙ ôÍ =& $_SERVER[ÆªÈ–¬]; self::valueSet($ïÙ ôÍ[1715], $ïÙ ôÍ[228]); self::log($ïÙ ôÍ[1733]); } public static function config($ó†ËÑã, $É†½ØóŠ) { self::valueSet($_SERVER[ÆªÈ–¬][816], $ó†ËÑã); } private static function taskRunAll() { $£Î›šèœ =& $_SERVER[ÆªÈ–¬]; $ÓƒÛ¡û° = timeFloat(); $¬”ØõçÁ = Model($£Î›šèœ[1734])->listData(); $€ÒÜñ¿â = count($¬”ØõçÁ); for ($™ı÷€¬Å = 0; $™ı÷€¬Å < $€ÒÜñ¿â; $™ı÷€¬Å++) { $“¸¤èé = $¬”ØõçÁ[$™ı÷€¬Å]; if (!$“¸¤èé[$£Î›šèœ[475]] || $“¸¤èé[$£Î›šèœ[1735]] != $£Î›šèœ[91]) { continue; } if (!self::taskTimeCheck($“¸¤èé)) { continue; } self::taskRun($“¸¤èé); } Hook::trigger($£Î›šèœ[1736]); self::taskQueueRun($ÓƒÛ¡û°); } private static function taskQueueRun($š½ŒÊÁ) { $óá‰ÂÇ = 10; while (!0) { $³¹¬‡è = TaskQueue::run(); if ($³¹¬‡è === !1) { break; } if (timeFloat() - $š½ŒÊÁ >= $óá‰ÂÇ) { break; } } } private static function taskTimeCheck($ë¾ÍÙŠü) { $ôÜå´È• =& $_SERVER[ÆªÈ–¬]; $œš®éî = json_decode($ë¾ÍÙŠü[$ôÜå´È•[206]], !0); $óÓì…Å = intval($ë¾ÍÙŠü[$ôÜå´È•[1716]]); $º°½‘Š = strtotime($ôÜå´È•[1737] . $œš®éî[$ôÜå´È•[1738]] . $ôÜå´È•[1739]) - strtotime($ôÜå´È•[1740]); $¸ª‚Çª¥ = time() - strtotime(date($ôÜå´È•[1741]) . $ôÜå´È•[1742]); $÷µÙûí = $¸ª‚Çª¥ >= $º°½‘Š && $¸ª‚Çª¥ <= $º°½‘Š + 3600; switch ($œš®éî[$ôÜå´È•[33]]) { case $ôÜå´È•[1743]: if (time() - $óÓì…Å < 3600 * 24 * 30) { return !1; } if ($œš®éî[$ôÜå´È•[1743]] == date($ôÜå´È•[1744]) && $÷µÙûí) { return !0; } break; case $ôÜå´È•[1745]: if (time() - $óÓì…Å < 3600 * 24 * 7) { return !1; } $üèïØ = date($ôÜå´È•[1746]) == 0 ? 7 : date($ôÜå´È•[1746]); if ($œš®éî[$ôÜå´È•[1745]] == $üèïØ && $÷µÙûí) { return !0; } break; case $ôÜå´È•[1738]: if (time() - $óÓì…Å < 3600 * 24) { return !1; } if ($÷µÙûí) { return !0; } break; case $ôÜå´È•[1747]: if (time() - $óÓì…Å >= floatval($œš®éî[$ôÜå´È•[1747]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $äßºı°÷ =& $_SERVER[ÆªÈ–¬]; static $ÅÏ×ö¾¯ = 0; $ÎÜßê  = 300; if (!$ÅÏ×ö¾¯) { $ÅÏ×ö¾¯ = time(); } if (time() - $ÅÏ×ö¾¯ < $ÎÜßê ) { return; } $ÅÏ×ö¾¯ = time(); $±ìüÛô¥ = Model($äßºı°÷[577])->db($äßºı°÷[12]); if ($±ìüÛô¥) { $±ìüÛô¥->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($äßºı°÷[1748], $äßºı°÷[1749]); die; } } public static function taskRun($å˜¤¤úé) { $ÃğŒÉ‹ =& $_SERVER[ÆªÈ–¬]; self::log($ÃğŒÉ‹[1750] . $å˜¤¤úé[$ÃğŒÉ‹[475]] . $ÃğŒÉ‹[1751] . $å˜¤¤úé[$ÃğŒÉ‹[32]] . $ÃğŒÉ‹[1752] . $å˜¤¤úé[$ÃğŒÉ‹[1753]]); Model($ÃğŒÉ‹[1734])->run($å˜¤¤úé[$ÃğŒÉ‹[475]]); $½®‰¨§€ = timeFloat(); $äÍÂ”›• = $ÃğŒÉ‹[12]; switch ($å˜¤¤úé[$ÃğŒÉ‹[33]]) { case $ÃğŒÉ‹[383]: $Çºñ¿á = url_request($å˜¤¤úé[$ÃğŒÉ‹[1753]], $ÃğŒÉ‹[261], !1, !1, !1, !1, 10); if ($Çºñ¿á[$ÃğŒÉ‹[816]]) { $äÍÂ”›• = strlen($Çºñ¿á[$ÃğŒÉ‹[1280]]); } break; case $ÃğŒÉ‹[260]: $äÍÂ”›• = Hook::apply($å˜¤¤úé[$ÃğŒÉ‹[1753]]); default: break; } Model($ÃğŒÉ‹[1754])->add(array($ÃğŒÉ‹[1755] => $ÃğŒÉ‹[12], $ÃğŒÉ‹[1756] => $ÃğŒÉ‹[228], $ÃğŒÉ‹[33] => $ÃğŒÉ‹[1757] . $å˜¤¤úé[$ÃğŒÉ‹[475]], $ÃğŒÉ‹[1758] => json_encode(array($ÃğŒÉ‹[32] => $å˜¤¤úé[$ÃğŒÉ‹[32]], $ÃğŒÉ‹[1759] => timeFloat() - $½®‰¨§€, $ÃğŒÉ‹[369] => $äÍÂ”›•)))); $Ò‡·Åîù = $äÍÂ”›• ? $ÃğŒÉ‹[1760] . $äÍÂ”›• : $ÃğŒÉ‹[12]; self::log($ÃğŒÉ‹[1761] . $å˜¤¤úé[$ÃğŒÉ‹[475]] . $ÃğŒÉ‹[178] . $Ò‡·Åîù); return !0; } public static function valueGet($øÚåÂƒÃ) { $»Ú™¦…” =& $_SERVER[ÆªÈ–¬]; $Üçììà = $»Ú™¦…”[1762]; $šäŒ¯Ğ¼ = Model($»Ú™¦…”[508])->get($øÚåÂƒÃ, $Üçììà); if (is_null($šäŒ¯Ğ¼)) { Model($»Ú™¦…”[508])->set($»Ú™¦…”[816], $»Ú™¦…”[91], $Üçììà); Model($»Ú™¦…”[508])->set($»Ú™¦…”[1715], $»Ú™¦…”[228], $Üçììà); $šäŒ¯Ğ¼ = Model($»Ú™¦…”[508])->get($øÚåÂƒÃ, $Üçììà); } return $šäŒ¯Ğ¼; } private static function valueSet($âß‚¬×Ù, $•õ¨¡²— = false) { $ä®ÜÊ²£ =& $_SERVER[ÆªÈ–¬]; $ü˜ÁèÅÖ = $ä®ÜÊ²£[1763]; CacheLock::lock($ü˜ÁèÅÖ); $ü•ìƒù = Model($ä®ÜÊ²£[508])->set($âß‚¬×Ù, $•õ¨¡²—, $ä®ÜÊ²£[1762]); CacheLock::unlock($ü˜ÁèÅÖ); return $ü•ìƒù; } protected static function log($Âõá×š¾) { write_log($Âõá×š¾, $_SERVER[ÆªÈ–¬][1749]); } private static function cacheClear() { $¯ë³‘®é =& $_SERVER[ÆªÈ–¬]; Cache::clearMemory(Model($¯ë³‘®é[508])->cacheKey($¯ë³‘®é[1762])); Cache::clearMemory(Model($¯ë³‘®é[508])->cacheKey($¯ë³‘®é[1764])); Model($¯ë³‘®é[1734])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\162\165\x6e\x6e\x69\x6e\147"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($êÛ»©–ş, $²ö÷õÎÆ = '', $¯ò¤şÃú = 0, $î„şŒÃ = '') { $äÕ™µ¦² =& $_SERVER[ÆªÈ–¬]; if (self::get($êÛ»©–ş)) { return; } $this->task = array($äÕ™µ¦²[475] => $êÛ»©–ş, $äÕ™µ¦²[1765] => USER_ID, $äÕ™µ¦²[1651] => $î„şŒÃ, $äÕ™µ¦²[526] => $äÕ™µ¦²[12], $äÕ™µ¦²[33] => $²ö÷õÎÆ, $äÕ™µ¦²[1136] => $äÕ™µ¦²[12], $äÕ™µ¦²[1134] => $¯ò¤şÃú, $äÕ™µ¦²[1766] => 0, $äÕ™µ¦²[1767] => 0, $äÕ™µ¦²[1768] => 0, $äÕ™µ¦²[1769] => timeFloat(), $äÕ™µ¦²[1770] => 0, $äÕ™µ¦²[1771] => 0, $äÕ™µ¦²[1772] => 0, $äÕ™µ¦²[1773] => 0, $äÕ™µ¦²[816] => $äÕ™µ¦²[1715]); $GLOBALS[$äÕ™µ¦²[1774]] = 1; Hook::bind($äÕ™µ¦²[1719], array($this, $äÕ™µ¦²[1775])); Hook::bind($äÕ™µ¦²[1776], array($this, $äÕ™µ¦²[1777])); $this->startAfter(); Hook::trigger($äÕ™µ¦²[1778], $this->task); $this->task[$äÕ™µ¦²[1771]] = timeFloat(); } public function end($£İ¨Ü‰€ = '') { $®çŒ«î =& $_SERVER[ÆªÈ–¬]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$®çŒ«î[1771]]) { self::valueSet($this->task[$®çŒ«î[475]], !1); } $this->isEnd = !0; if ($£İ¨Ü‰€) { $this->task[$®çŒ«î[526]] = $£İ¨Ü‰€; } self::log($®çŒ«î[1779] . $this->task[$®çŒ«î[475]] . $®çŒ«î[1780] . sprintf($®çŒ«î[924], timeFloat() - $this->task[$®çŒ«î[1769]]) . $®çŒ«î[1781]); Hook::unbind($®çŒ«î[1719], array($this, $®çŒ«î[1775])); Hook::unbind($®çŒ«î[1776], array($this, $®çŒ«î[1777])); $this->endAfter(); $ôÀ…¬¢¾ = $this->task; $this->task = !1; Hook::trigger($®çŒ«î[1782], $ôÀ…¬¢¾); } public function update($ÉÌ¬Á = 0, $ ¨¬É¢¿ = false) { $îÊ•Æ¥¸ =& $_SERVER[ÆªÈ–¬]; $‹Ì¦«Åœ =& $this->task; if (!$‹Ì¦«Åœ) { return; } $‹Ì¦«Åœ[$îÊ•Æ¥¸[1766]] += $ÉÌ¬Á; $‹Ì¦«Åœ[$îÊ•Æ¥¸[1770]] = timeFloat(); if ($‹Ì¦«Åœ[$îÊ•Æ¥¸[1134]]) { if ($‹Ì¦«Åœ[$îÊ•Æ¥¸[1134]] < $‹Ì¦«Åœ[$îÊ•Æ¥¸[1766]]) { $‹Ì¦«Åœ[$îÊ•Æ¥¸[1134]] = $‹Ì¦«Åœ[$îÊ•Æ¥¸[1766]]; } $’Úˆàïç = timeFloat() - $‹Ì¦«Åœ[$îÊ•Æ¥¸[1769]] - $‹Ì¦«Åœ[$îÊ•Æ¥¸[1772]]; if ($’Úˆàïç <= 0) { $’Úˆàïç = 0.001; } $‹Ì¦«Åœ[$îÊ•Æ¥¸[1767]] = $‹Ì¦«Åœ[$îÊ•Æ¥¸[1766]] / $‹Ì¦«Åœ[$îÊ•Æ¥¸[1134]]; $‹Ì¦«Åœ[$îÊ•Æ¥¸[1768]] = $‹Ì¦«Åœ[$îÊ•Æ¥¸[1766]] / $’Úˆàïç; if ($‹Ì¦«Åœ[$îÊ•Æ¥¸[1767]] > 0) { $‹Ì¦«Åœ[$îÊ•Æ¥¸[1773]] = $’Úˆàïç * (1 - $‹Ì¦«Åœ[$îÊ•Æ¥¸[1767]]) / $‹Ì¦«Åœ[$îÊ•Æ¥¸[1767]]; } $‹Ì¦«Åœ[$îÊ•Æ¥¸[1773]] = $‹Ì¦«Åœ[$îÊ•Æ¥¸[1773]] <= 0 ? 0 : $‹Ì¦«Åœ[$îÊ•Æ¥¸[1773]]; } $this->updateAfter(); $Ì‹†ÑÚì = 0.2; if (timeFloat() - $‹Ì¦«Åœ[$îÊ•Æ¥¸[1771]] < $Ì‹†ÑÚì && !$ ¨¬É¢¿) { return; } $ã›’Œ¦ª = self::get($‹Ì¦«Åœ[$îÊ•Æ¥¸[475]]); $È«âÛ¬ = $ã›’Œ¦ª[$îÊ•Æ¥¸[816]]; if ($È«âÛ¬ == self::STATYS_KILL) { $Ï´íÆî¢ = array($îÊ•Æ¥¸[1783] => LNG($îÊ•Æ¥¸[1784]), $îÊ•Æ¥¸[1290] => !1); Cache::set($îÊ•Æ¥¸[1785] . $this->task[$îÊ•Æ¥¸[475]], $Ï´íÆî¢, 30); $this->onKill(); $this->end(); die; } else { if ($È«âÛ¬ == self::STATYS_STOP) { $†¡ûƒú = 2; $ã›’Œ¦ª[$îÊ•Æ¥¸[1772]] += $†¡ûƒú; self::valueSet($‹Ì¦«Åœ[$îÊ•Æ¥¸[475]], $ã›’Œ¦ª); sleep($†¡ûƒú); $this->update(); return; } } $‹Ì¦«Åœ[$îÊ•Æ¥¸[816]] = $È«âÛ¬ ? $È«âÛ¬ : $‹Ì¦«Åœ[$îÊ•Æ¥¸[816]]; $‹Ì¦«Åœ[$îÊ•Æ¥¸[1772]] = $ã›’Œ¦ª[$îÊ•Æ¥¸[1772]] ? $ã›’Œ¦ª[$îÊ•Æ¥¸[1772]] : 0; $‹Ì¦«Åœ[$îÊ•Æ¥¸[1771]] = timeFloat(); Hook::trigger($îÊ•Æ¥¸[1786], $‹Ì¦«Åœ); self::valueSet($‹Ì¦«Åœ[$îÊ•Æ¥¸[475]], $‹Ì¦«Åœ); } public function onKillSet($ì¹İŒ­¨, $¸ØÑÌş½ = array()) { $this->onKillCall = array($ì¹İŒ­¨, $¸ØÑÌş½); } public function onKill() { $ÙÍê”Ö« =& $_SERVER[ÆªÈ–¬]; self::log($ÙÍê”Ö«[1779] . $this->task[$ÙÍê”Ö«[475]] . $ÙÍê”Ö«[1787]); Hook::trigger($ÙÍê”Ö«[1788], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($²’ÑªÍ±) { $×Ä’ü =& $_SERVER[ÆªÈ–¬]; Cache::set($×Ä’ü[1785] . $this->task[$×Ä’ü[475]], $²’ÑªÍ±, 60); return $²’ÑªÍ±; } public static function get($ã¹¸…ªÖ) { $°›Ÿ¹Ü‚ =& $_SERVER[ÆªÈ–¬]; $†Ö´Õñ = self::valueGet($ã¹¸…ªÖ); if (is_array($†Ö´Õñ) && $†Ö´Õñ[$°›Ÿ¹Ü‚[1789]]) { $ı÷§ú„ã = ActionApply($†Ö´Õñ[$°›Ÿ¹Ü‚[1789]], array($†Ö´Õñ)); $†Ö´Õñ = is_array($ı÷§ú„ã) ? $ı÷§ú„ã : $†Ö´Õñ; } return $†Ö´Õñ; } public static function listData() { $íÅ˜Ìãœ = self::valueGet(); return array_sort_by($íÅ˜Ìãœ, $_SERVER[ÆªÈ–¬][1769], !0); } public static function kill($çÉ¡Ú«) { return self::changeStatus($çÉ¡Ú«, self::STATYS_KILL); } public static function stop($ÒÁ¤äù¼) { return self::changeStatus($ÒÁ¤äù¼, self::STATYS_STOP); } public static function restart($óŞÔ€ÚÚ) { return self::changeStatus($óŞÔ€ÚÚ, self::STATYS_RUNNING); } public static function killAll() { $Á†¿Ñº =& $_SERVER[ÆªÈ–¬]; $¥™„™‚¿ = self::listData(); foreach ($¥™„™‚¿ as $é˜÷×¸) { self::kill($é˜÷×¸[$Á†¿Ñº[475]]); } sleep(2); foreach ($¥™„™‚¿ as $é˜÷×¸) { self::valueSet($é˜÷×¸[$Á†¿Ñº[475]], !1); } } private static function changeStatus($¢åòÆó§, $¥œ±Àéñ) { $ïŒéÃ®æ =& $_SERVER[ÆªÈ–¬]; $ÂÁ› ÔÃ = self::valueGet($¢åòÆó§); if (!$ÂÁ› ÔÃ) { return !1; } $ÂÁ› ÔÃ[$ïŒéÃ®æ[816]] = $¥œ±Àéñ; self::valueSet($¢åòÆó§, $ÂÁ› ÔÃ); self::log($ïŒéÃ®æ[1790] . $ÂÁ› ÔÃ[$ïŒéÃ®æ[475]] . $ïŒéÃ®æ[1791] . $¥œ±Àéñ); return !0; } public static function valueGet($åÓ¶ìÒ’ = false) { $ÚçŸ£¬¬ =& $_SERVER[ÆªÈ–¬]; if ($åÓ¶ìÒ’) { $‚µ©†Ï = Model($ÚçŸ£¬¬[520])->where(array($ÚçŸ£¬¬[97] => $åÓ¶ìÒ’, $ÚçŸ£¬¬[33] => $ÚçŸ£¬¬[1143]))->find(); return $‚µ©†Ï ? json_decode($‚µ©†Ï[$ÚçŸ£¬¬[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ú”¢ ªã = false) { $ıÓ„ªÙ¢ =& $_SERVER[ÆªÈ–¬]; $ĞåÁ¨‘× = array($ıÓ„ªÙ¢[33] => $ıÓ„ªÙ¢[1143]); if ($ú”¢ ªã) { $ĞåÁ¨‘×[$ıÓ„ªÙ¢[1765]] = $ú”¢ ªã; } $Ò³ÁÆ’¡ = Model($ıÓ„ªÙ¢[520])->where($ĞåÁ¨‘×)->select(); $Ò³ÁÆ’¡ = $Ò³ÁÆ’¡ ? $Ò³ÁÆ’¡ : array(); foreach ($Ò³ÁÆ’¡ as $‡€ĞÏï => $…Å¥‡ù„) { $Ò³ÁÆ’¡[$‡€ĞÏï] = json_decode($…Å¥‡ù„[$ıÓ„ªÙ¢[450]], !0); } return $Ò³ÁÆ’¡; } public static function valueSet($™Ş…æøî, $¬Ù€äŞ´) { $Ó¿ÄÜó =& $_SERVER[ÆªÈ–¬]; if (!$¬Ù€äŞ´) { return Model($Ó¿ÄÜó[520])->where(array($Ó¿ÄÜó[97] => $™Ş…æøî, $Ó¿ÄÜó[33] => $Ó¿ÄÜó[1143]))->delete(); } $ãìÖËë = json_encode($¬Ù€äŞ´); if (!$ãìÖËë) { ob_start(); var_dump($¬Ù€äŞ´); $‹ÍŠÔ³è = ob_get_clean(); self::log($Ó¿ÄÜó[1792] . json_encode_force($‹ÍŠÔ³è)); } if (!$™Ş…æøî || !$¬Ù€äŞ´[$Ó¿ÄÜó[475]]) { return !1; } $ş‚˜Şâ = array($Ó¿ÄÜó[33] => $Ó¿ÄÜó[1143], $Ó¿ÄÜó[1765] => USER_ID, $Ó¿ÄÜó[97] => $™Ş…æøî, $Ó¿ÄÜó[450] => $ãìÖËë); $¹²ÇÍŸ± = $Ó¿ÄÜó[1793]; CacheLock::lock($¹²ÇÍŸ±); Model($Ó¿ÄÜó[520])->add($ş‚˜Şâ, array(), !0); CacheLock::unlock($¹²ÇÍŸ±); } public static function log($ë¹á¬º¨) { if (!GLOBAL_DEBUG) { return; } write_log($ë¹á¬º¨, $_SERVER[ÆªÈ–¬][1794]); } } class TaskFileTransfer extends Task { protected function startAfter() { $„Ü·¨ Ü =& $_SERVER[ÆªÈ–¬]; $ı¯¯Ãø =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($„Ü·¨ Ü[1795], array($this, $„Ü·¨ Ü[1796])); Hook::bind($„Ü·¨ Ü[1301], array($this, $„Ü·¨ Ü[1797])); Hook::bind($„Ü·¨ Ü[1798], array($this, $„Ü·¨ Ü[1799])); Hook::bind($„Ü·¨ Ü[668], array($this, $„Ü·¨ Ü[1800])); Hook::bind($„Ü·¨ Ü[669], array($this, $„Ü·¨ Ü[1801])); Hook::bind($„Ü·¨ Ü[675], array($this, $„Ü·¨ Ü[1802])); Hook::bind($„Ü·¨ Ü[676], array($this, $„Ü·¨ Ü[1803])); Hook::bind($„Ü·¨ Ü[671], array($this, $„Ü·¨ Ü[1804])); Hook::bind($„Ü·¨ Ü[673], array($this, $„Ü·¨ Ü[1805])); Hook::bind($„Ü·¨ Ü[637], array($this, $„Ü·¨ Ü[1806])); Hook::bind($„Ü·¨ Ü[634], array($this, $„Ü·¨ Ü[1806])); Hook::bind($„Ü·¨ Ü[639], array($this, $„Ü·¨ Ü[1806])); Hook::bind($„Ü·¨ Ü[641], array($this, $„Ü·¨ Ü[1806])); Hook::bind($„Ü·¨ Ü[643], array($this, $„Ü·¨ Ü[1806])); Hook::bind($„Ü·¨ Ü[1807], array($this, $„Ü·¨ Ü[1808])); Hook::bind($„Ü·¨ Ü[659], array($this, $„Ü·¨ Ü[1809])); $this->sourceModelCopyFlag = !1; Hook::bind($„Ü·¨ Ü[1810], array($this, $„Ü·¨ Ü[1811])); Hook::bind($„Ü·¨ Ü[1812], array($this, $„Ü·¨ Ü[1813])); Hook::bind($„Ü·¨ Ü[1814], array($this, $„Ü·¨ Ü[1815])); $ı¯¯Ãø[$„Ü·¨ Ü[1816]] = LNG($„Ü·¨ Ü[1817]); $ı¯¯Ãø[$„Ü·¨ Ü[1818]] = 0; $ı¯¯Ãø[$„Ü·¨ Ü[1819]] = 0; $ı¯¯Ãø[$„Ü·¨ Ü[1136]] = $„Ü·¨ Ü[12]; $ı¯¯Ãø[$„Ü·¨ Ü[1820]] = $„Ü·¨ Ü[12]; $ı¯¯Ãø[$„Ü·¨ Ü[1821]] = 0; $ı¯¯Ãø[$„Ü·¨ Ü[1822]] = 0; $ı¯¯Ãø[$„Ü·¨ Ü[1823]] = 0; if (!$ı¯¯Ãø[$„Ü·¨ Ü[1651]]) { $ı¯¯Ãø[$„Ü·¨ Ü[1651]] = LNG($„Ü·¨ Ü[1824]); } } protected function endAfter() { $“–Œì¤Ì =& $_SERVER[ÆªÈ–¬]; Hook::unbind($“–Œì¤Ì[1795], array($this, $“–Œì¤Ì[1796])); Hook::unbind($“–Œì¤Ì[1301], array($this, $“–Œì¤Ì[1797])); Hook::unbind($“–Œì¤Ì[1798], array($this, $“–Œì¤Ì[1799])); Hook::unbind($“–Œì¤Ì[668], array($this, $“–Œì¤Ì[1800])); Hook::unbind($“–Œì¤Ì[669], array($this, $“–Œì¤Ì[1801])); Hook::unbind($“–Œì¤Ì[675], array($this, $“–Œì¤Ì[1802])); Hook::unbind($“–Œì¤Ì[676], array($this, $“–Œì¤Ì[1803])); Hook::unbind($“–Œì¤Ì[671], array($this, $“–Œì¤Ì[1804])); Hook::unbind($“–Œì¤Ì[673], array($this, $“–Œì¤Ì[1805])); Hook::unbind($“–Œì¤Ì[637], array($this, $“–Œì¤Ì[1806])); Hook::unbind($“–Œì¤Ì[634], array($this, $“–Œì¤Ì[1806])); Hook::unbind($“–Œì¤Ì[639], array($this, $“–Œì¤Ì[1806])); Hook::unbind($“–Œì¤Ì[641], array($this, $“–Œì¤Ì[1806])); Hook::unbind($“–Œì¤Ì[643], array($this, $“–Œì¤Ì[1806])); Hook::unbind($“–Œì¤Ì[1807], array($this, $“–Œì¤Ì[1808])); Hook::unbind($“–Œì¤Ì[659], array($this, $“–Œì¤Ì[1809])); Hook::unbind($“–Œì¤Ì[1810], array($this, $“–Œì¤Ì[1811])); Hook::unbind($“–Œì¤Ì[1812], array($this, $“–Œì¤Ì[1813])); Hook::unbind($“–Œì¤Ì[1814], array($this, $“–Œì¤Ì[1815])); } public function copyMoveStart($‰Îøë³„, $Ÿ®îêÔñ, $ÅĞûº¤, $ÒÛÄƒÚ) { $®Õ¬—ı› =& $_SERVER[ÆªÈ–¬]; self::log($®Õ¬—ı›[1825] . $Ÿ®îêÔñ . $®Õ¬—ı›[73] . $ÒÛÄƒÚ); $÷“ö¯Ë = rtrim(TEMP_FILES, $®Õ¬—ı›[8]); if (substr($Ÿ®îêÔñ, 0, strlen($÷“ö¯Ë)) == $÷“ö¯Ë) { return; } if (substr($ÒÛÄƒÚ, 0, strlen($÷“ö¯Ë)) == $÷“ö¯Ë) { return; } $ß„›ÖÁ× =& $this->task; $ß„›ÖÁ×[$®Õ¬—ı›[1826]] = KodIO::transferType($‰Îøë³„, $ÅĞûº¤); $this->update(); } public function updateAfter() { $‰™ş±çÖ =& $_SERVER[ÆªÈ–¬]; $À‡Ì¿¹È =& $this->task; if (!$À‡Ì¿¹È[$‰™ş±çÖ[829]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($À‡Ì¿¹È[$‰™ş±çÖ[1826]] == $‰™ş±çÖ[1394]) { return; } self::updateTask($À‡Ì¿¹È); } private static function updateTask(&$ÎôêÙß‡) { $ê†ÜÆÌ™ =& $_SERVER[ÆªÈ–¬]; if ($ÎôêÙß‡[$ê†ÜÆÌ™[1826]] == $ê†ÜÆÌ™[1272] || $ÎôêÙß‡[$ê†ÜÆÌ™[1826]] == $ê†ÜÆÌ™[110]) { if ($ÎôêÙß‡[$ê†ÜÆÌ™[1820]]) { $ÎôêÙß‡[$ê†ÜÆÌ™[1823]] = $ÎôêÙß‡[$ê†ÜÆÌ™[1822]] + $ÎôêÙß‡[$ê†ÜÆÌ™[1819]]; } } else { if ($ÎôêÙß‡[$ê†ÜÆÌ™[1826]] == $ê†ÜÆÌ™[1395]) { if ($ÎôêÙß‡[$ê†ÜÆÌ™[1820]] == $ê†ÜÆÌ™[1272]) { $ÎôêÙß‡[$ê†ÜÆÌ™[1823]] = $ÎôêÙß‡[$ê†ÜÆÌ™[1822]] + $ÎôêÙß‡[$ê†ÜÆÌ™[1819]] * 0.5; } else { if ($ÎôêÙß‡[$ê†ÜÆÌ™[1820]] == $ê†ÜÆÌ™[110]) { $ÎôêÙß‡[$ê†ÜÆÌ™[1823]] = $ÎôêÙß‡[$ê†ÜÆÌ™[1822]] + $ÎôêÙß‡[$ê†ÜÆÌ™[1818]] * 0.5 + $ÎôêÙß‡[$ê†ÜÆÌ™[1819]] * 0.5; } } } } $ÎôêÙß‡[$ê†ÜÆÌ™[1767]] = $ÎôêÙß‡[$ê†ÜÆÌ™[1823]] / $ÎôêÙß‡[$ê†ÜÆÌ™[829]]; if ($ÎôêÙß‡[$ê†ÜÆÌ™[1767]] > 0) { $šéñÊçø = timeFloat() - $ÎôêÙß‡[$ê†ÜÆÌ™[1769]] - $ÎôêÙß‡[$ê†ÜÆÌ™[1772]]; $ÎôêÙß‡[$ê†ÜÆÌ™[1773]] = $šéñÊçø * (1 - $ÎôêÙß‡[$ê†ÜÆÌ™[1767]]) / $ÎôêÙß‡[$ê†ÜÆÌ™[1767]]; } } public function addPath($°ãÉó³) { $éè¨ÒÎ =& $_SERVER[ÆªÈ–¬]; if (!$°ãÉó³) { return; } $Îû±¬ù± =& $this->task; $™†Àœ Ç = IO::infoWithChildren($°ãÉó³); $Ì™Ôœ©Œ = $Îû±¬ù±[$éè¨ÒÎ[1827]] ? $Îû±¬ù±[$éè¨ÒÎ[1827]][$éè¨ÒÎ[1828]] : 0; $Îû±¬ù±[$éè¨ÒÎ[1827]] = array($éè¨ÒÎ[1828] => $Ì™Ôœ©Œ + 1, $éè¨ÒÎ[494] => $™†Àœ Ç[$éè¨ÒÎ[32]], $éè¨ÒÎ[87] => $™†Àœ Ç[$éè¨ÒÎ[87]], $éè¨ÒÎ[582] => $™†Àœ Ç[$éè¨ÒÎ[582]] ? $™†Àœ Ç[$éè¨ÒÎ[582]] : $™†Àœ Ç[$éè¨ÒÎ[87]]); if ($™†Àœ Ç[$éè¨ÒÎ[33]] == $éè¨ÒÎ[230]) { $Îû±¬ù±[$éè¨ÒÎ[1134]] += 1; } else { $Îû±¬ù±[$éè¨ÒÎ[1134]] += $™†Àœ Ç[$éè¨ÒÎ[82]][$éè¨ÒÎ[80]]; if ($™†Àœ Ç[$éè¨ÒÎ[193]]) { $Îû±¬ù±[$éè¨ÒÎ[1134]] += $™†Àœ Ç[$éè¨ÒÎ[82]][$éè¨ÒÎ[81]] + 1; } } $Îû±¬ù±[$éè¨ÒÎ[829]] += $™†Àœ Ç[$éè¨ÒÎ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($´÷Şâ¤Ç) { } public function sourceAddHashEnd($­¢•¯’²) { } public function sourceAddFileStart($¯¥ªÛçı) { $ú™¨¤£Ô =& $_SERVER[ÆªÈ–¬]; $­‰Ûµá… =& $this->task; $­‰Ûµá…[$ú™¨¤£Ô[1818]] = $¯¥ªÛçı[$ú™¨¤£Ô[79]]; $­‰Ûµá…[$ú™¨¤£Ô[1816]] = $¯¥ªÛçı[$ú™¨¤£Ô[32]]; $­‰Ûµá…[$ú™¨¤£Ô[1136]] = $¯¥ªÛçı[$ú™¨¤£Ô[32]]; $­‰Ûµá…[$ú™¨¤£Ô[1829]] = $¯¥ªÛçı[$ú™¨¤£Ô[87]]; $this->update(); } public function sourceAddFileEnd($š÷àü÷) { $¯ˆ•Ñïö =& $_SERVER[ÆªÈ–¬]; $ØŞØ¸ÔÁ =& $this->task; $ØŞØ¸ÔÁ[$¯ˆ•Ñïö[1823]] += $š÷àü÷[$¯ˆ•Ñïö[79]]; $ØŞØ¸ÔÁ[$¯ˆ•Ñïö[1829]] = $š÷àü÷[$¯ˆ•Ñïö[87]]; $this->update(1); } public function copyFileStart($»ÁÚ™ˆÌ, $Ááß´áø, $ù¡¥…îœ, $‹¦‘ë‰ş, $ÕÛš¦ã°, $Š­¹Çš) { $áÍŞçè =& $_SERVER[ÆªÈ–¬]; $ì‰†ĞãÖ = $ÕÛš¦ã°; if ($ì‰†ĞãÖ == $GLOBALS[$áÍŞçè[1830]]) { $ì‰†ĞãÖ = $GLOBALS[$áÍŞçè[1831]]; } $GLOBALS[$áÍŞçè[1831]] = $ÕÛš¦ã°; $GLOBALS[$áÍŞçè[1830]] = $Š­¹Çš; $àøåŞ€é =& $this->task; $àøåŞ€é[$áÍŞçè[1816]] = $ì‰†ĞãÖ; $àøåŞ€é[$áÍŞçè[1818]] = (int) $»ÁÚ™ˆÌ->size($Ááß´áø); $àøåŞ€é[$áÍŞçè[1819]] = 0; $àøåŞ€é[$áÍŞçè[1136]] = $áÍŞçè[12]; $àøåŞ€é[$áÍŞçè[1820]] = $áÍŞçè[12]; $àøåŞ€é[$áÍŞçè[1821]] = 0; $¤¢ÄÈè‚ = $àøåŞ€é[$áÍŞçè[1818]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($àøåŞ€é[$áÍŞçè[475]] . $áÍŞçè[1832]); if ($¤¢ÄÈè‚ && file_exists(get_path_father($‹¦‘ë‰ş))) { Cache::set($àøåŞ€é[$áÍŞçè[475]] . $áÍŞçè[1832], $‹¦‘ë‰ş); $àøåŞ€é[$áÍŞçè[1789]] = array($áÍŞçè[1833], $áÍŞçè[1834]); } $this->update(0, $¤¢ÄÈè‚); } public static function updateCopyLocalFileSize($†ªü¥¥†) { $ÂØ¦©ÊÉ =& $_SERVER[ÆªÈ–¬]; $Ş¬ÜÜ© = Cache::get($†ªü¥¥†[$ÂØ¦©ÊÉ[475]] . $ÂØ¦©ÊÉ[1832]); if (!$Ş¬ÜÜ© || !file_exists($Ş¬ÜÜ©)) { return $†ªü¥¥†; } $†ªü¥¥†[$ÂØ¦©ÊÉ[1819]] = @filesize($Ş¬ÜÜ©); $†ªü¥¥†[$ÂØ¦©ÊÉ[1823]] += $†ªü¥¥†[$ÂØ¦©ÊÉ[1819]]; self::updateTask($†ªü¥¥†); return $†ªü¥¥†; } public function copyFileEnd($Ì”²¦Ÿç, $öÑÖ´ÃÔ, $ŸÑßéÆŞ, $î”„Ò¢°, $¸·Èù•, $“¢ÁÙ…§) { $®À¸›‰î =& $_SERVER[ÆªÈ–¬]; $«¾±œ­ =& $this->task; $«¾±œ­[$®À¸›‰î[1819]] = $«¾±œ­[$®À¸›‰î[1818]]; $«¾±œ­[$®À¸›‰î[1820]] = $®À¸›‰î[12]; unset($«¾±œ­[$®À¸›‰î[1789]]); if ($¸·Èù• == $«¾±œ­[$®À¸›‰î[1816]]) { $«¾±œ­[$®À¸›‰î[1822]] += $«¾±œ­[$®À¸›‰î[1818]]; $«¾±œ­[$®À¸›‰î[1823]] = $«¾±œ­[$®À¸›‰î[1822]]; $½Ù­«‘ = 1; if (isset($«¾±œ­[$®À¸›‰î[1829]]) && $«¾±œ­[$®À¸›‰î[1829]] == $öÑÖ´ÃÔ) { $½Ù­«‘ = 0; } $this->update($½Ù­«‘); } else { $this->update(); $«¾±œ­[$®À¸›‰î[1819]] = 0; } Cache::remove($«¾±œ­[$®À¸›‰î[475]] . $®À¸›‰î[1832]); self::log($®À¸›‰î[1835] . $öÑÖ´ÃÔ . $®À¸›‰î[73] . $î”„Ò¢° . $®À¸›‰î[262] . $¸·Èù• . $®À¸›‰î[1836] . $«¾±œ­[$®À¸›‰î[1816]]); } public function updateFileEnd($º¾‘ïˆ, $êç¹è«) { $ú»Î¿“’ =& $_SERVER[ÆªÈ–¬]; $‡€¾ =& $this->task; $‡€¾[$ú»Î¿“’[1816]] = $º¾‘ïˆ; $‡€¾[$ú»Î¿“’[1818]] = $êç¹è«; $‡€¾[$ú»Î¿“’[1822]] += $êç¹è«; $‡€¾[$ú»Î¿“’[1823]] = $‡€¾[$ú»Î¿“’[1822]]; $this->update(1); self::log($ú»Î¿“’[1837] . $º¾‘ïˆ); } public function sourceModelCopy($Àƒ¬Ïú²) { $­‡·¶ë± =& $_SERVER[ÆªÈ–¬]; $‘µŞ ´‹ = $Àƒ¬Ïú²[0]; $Ñûˆ¾Û§ = $Àƒ¬Ïú²[1]; $®¶¥ˆı =& $this->task; $this->sourceModelCopyFlag = !0; $Öæá¹Š† = 0; switch ($‘µŞ ´‹) { case $­‡·¶ë±[635]: $Öæá¹Š† = 1; break; case $­‡·¶ë±[638]: $®¶¥ˆı[$­‡·¶ë±[1816]] = $Ñûˆ¾Û§[$­‡·¶ë±[32]]; break; case $­‡·¶ë±[640]: $Öæá¹Š† = intval($Àƒ¬Ïú²[$­‡·¶ë±[456]] * 0.4); break; case $­‡·¶ë±[642]: $Öæá¹Š† = intval($Àƒ¬Ïú²[$­‡·¶ë±[456]] * 0.2); break; case $­‡·¶ë±[644]: $Öæá¹Š† = intval($Àƒ¬Ïú²[$­‡·¶ë±[456]] * 0.4); break; } $this->update($Öæá¹Š†); $this->sourceModelCopyFlag = !1; } public function sourceRemove($š¢²Âò, $Äû¥Š˜Õ) { $•‘òÕ‚ù =& $_SERVER[ÆªÈ–¬]; $this->sourceModelCopyFlag = !0; $¢¤ö—˜Ğ = 1; if (isset($š¢²Âò[$•‘òÕ‚ù[82]])) { $¢¤ö—˜Ğ = $š¢²Âò[$•‘òÕ‚ù[82]][$•‘òÕ‚ù[80]]; $¢¤ö—˜Ğ = $¢¤ö—˜Ğ + $š¢²Âò[$•‘òÕ‚ù[82]][$•‘òÕ‚ù[81]] + 1; } $this->update($¢¤ö—˜Ğ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ç›Ëå¼Ø) { $this->sourceRemove($Ç›Ëå¼Ø, !1); } public function curlProgress($Ï›ÀøÙì, $Ä‘úØÎ¡, $¨±£¼€¿, $ÍÚáïÇë, $±Ô’£ÕÂ) { $œ¡ÇÃ¹ =& $_SERVER[ÆªÈ–¬]; $ùÍ¦Š‹Õ =& $this->task; if ($±Ô’£ÕÂ > 0) { $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1136]] = $œ¡ÇÃ¹[1838]; $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1820]] = $œ¡ÇÃ¹[110]; if ($ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1818]]) { $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1819]] = $±Ô’£ÕÂ; } if ($ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1821]]) { $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1819]] = $±Ô’£ÕÂ + $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1821]]; } } else { if ($¨±£¼€¿ > 0) { if ($ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1818]] == $Ä‘úØÎ¡) { $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1819]] = $¨±£¼€¿; $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1136]] = $œ¡ÇÃ¹[1839]; $ùÍ¦Š‹Õ[$œ¡ÇÃ¹[1820]] = $œ¡ÇÃ¹[1272]; } } } $this->update(); } public function curlProgressStart($ÎÁ˜³Ë‰) { } public function curlProgressEnd($Ï÷“¯ø÷) { $»ì´“Ò½ =& $_SERVER[ÆªÈ–¬]; $¿˜‡°Õ¸ =& $this->task; $¬íÆÊÜÒ = curl_getinfo($Ï÷“¯ø÷); $ıÎÊÙ±· = $¬íÆÊÜÒ[$»ì´“Ò½[1840]]; if ($ıÎÊÙ±· == -1) { $ıÎÊÙ±· = $¬íÆÊÜÒ[$»ì´“Ò½[1841]]; } if ($¿˜‡°Õ¸[$»ì´“Ò½[1820]] == $»ì´“Ò½[110] && $ıÎÊÙ±·) { $¿˜‡°Õ¸[$»ì´“Ò½[1821]] += $ıÎÊÙ±·; } $this->update(); } } goto Eã“´™±º; Eã“´™±º: class TaskHttp extends Task { protected function startAfter() { $úàÜ¿ =& $_SERVER[ÆªÈ–¬]; $§ñ”—ú¨ =& $this->task; $§ñ”—ú¨[$úàÜ¿[1842]] = 1; Hook::bind($úàÜ¿[1810], array($this, $úàÜ¿[1843])); Hook::bind($úàÜ¿[1812], array($this, $úàÜ¿[1844])); Hook::bind($úàÜ¿[1814], array($this, $úàÜ¿[1845])); } protected function endAfter() { $¦¸ÍŞàÑ =& $_SERVER[ÆªÈ–¬]; Hook::unbind($¦¸ÍŞàÑ[1810], array($this, $¦¸ÍŞàÑ[1843])); Hook::unbind($¦¸ÍŞàÑ[1812], array($this, $¦¸ÍŞàÑ[1844])); Hook::unbind($¦¸ÍŞàÑ[1814], array($this, $¦¸ÍŞàÑ[1845])); } public function progressStart($êƒèé‹·) { $œ«Ï—¥‡ =& $_SERVER[ÆªÈ–¬]; $í§½©„ = curl_getinfo($êƒèé‹·); self::log($œ«Ï—¥‡[1846] . $í§½©„[$œ«Ï—¥‡[383]]); self::valueSet($this->task[$œ«Ï—¥‡[475]], $this->task); } public function progressEnd($ÌÛ¼Àµ) { $ƒîşï” =& $_SERVER[ÆªÈ–¬]; self::log($ƒîşï”[1847] . $this->task[$ƒîşï”[475]]); $this->end(); } public function progress($€È±›”¥, $ÛÙÓÑ±, $éØ†Ú¿ , $áÚÍÁ’Ç, $¦ËÕŠŸï) { $Â²½‘¦Ä =& $_SERVER[ÆªÈ–¬]; $¼—ŒéåÄ =& $this->task; if ($¦ËÕŠŸï > 0) { $¼—ŒéåÄ[$Â²½‘¦Ä[1134]] = $¼—ŒéåÄ[$Â²½‘¦Ä[1134]] == 0 ? $áÚÍÁ’Ç : $¼—ŒéåÄ[$Â²½‘¦Ä[1134]]; $¼—ŒéåÄ[$Â²½‘¦Ä[1766]] = $¦ËÕŠŸï; } else { if ($éØ†Ú¿  > 0) { $¼—ŒéåÄ[$Â²½‘¦Ä[1134]] = $¼—ŒéåÄ[$Â²½‘¦Ä[1134]] == 0 ? $ÛÙÓÑ± : $¼—ŒéåÄ[$Â²½‘¦Ä[1134]]; $¼—ŒéåÄ[$Â²½‘¦Ä[1766]] = $éØ†Ú¿ ; } } $this->update(); self::log("\x70\x72\157\147\x72\x65\163\x73\x48\x74\164\160\x3a\x64\x6f\x77\x6e\72{$éØ†Ú¿ }\x2f{$ÛÙÓÑ±}\73\x20\165\160\154\157\x61\x64\72{$¦ËÕŠŸï}\57{$áÚÍÁ’Ç}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ì‡şÀº, $ß¿Ï±— = '', $È’İÌŸÓ = 0, $†µÕ˜¥¾ = '') { $ìØÑÇ…à =& $_SERVER[ÆªÈ–¬]; $†µÕ˜¥¾ = $†µÕ˜¥¾ ? $†µÕ˜¥¾ : ($ß¿Ï±— ? $ß¿Ï±— : $ì‡şÀº); $Şƒ¾ª½Ô = new Task($ì‡şÀº, $ß¿Ï±—, $È’İÌŸÓ, $†µÕ˜¥¾); $GLOBALS[$ìØÑÇ…à[1848] . $ì‡şÀº] = new TaskLog($ìØÑÇ…à[1749], $Şƒ¾ª½Ô, $†µÕ˜¥¾); return $Şƒ¾ª½Ô; } public function __construct($™¨†ë©² = '', $è›—º«š = '', $úÊÉ“Ëî = '') { $ÁÊƒ‘ =& $_SERVER[ÆªÈ–¬]; if (!$™¨†ë©²) { $™¨†ë©² = $ÁÊƒ‘[1749]; } $ğ°Õßóş = $™¨†ë©² . $ÁÊƒ‘[462] . rand_string(10); if (!$úÊÉ“Ëî) { $úÊÉ“Ëî = $™¨†ë©² . $ÁÊƒ‘[53] . $úÊÉ“Ëî; } switch ($™¨†ë©²) { case $ÁÊƒ‘[1749]: if (!$è›—º«š || !$è›—º«š->task) { return echoLog($™¨†ë©² . $ÁÊƒ‘[1849]); } $öø¼µ–è = $è›—º«š; $ğ°Õßóş = $öø¼µ–è->task[$ÁÊƒ‘[475]]; $™¨†ë©² = $öø¼µ–è->task[$ÁÊƒ‘[475]]; if (!$öø¼µ–è->task[$ÁÊƒ‘[1651]]) { $öø¼µ–è->task[$ÁÊƒ‘[1651]] = $úÊÉ“Ëî ? $úÊÉ“Ëî : $™¨†ë©²; } break; case $ÁÊƒ‘[1850]: if (!$è›—º«š) { return echoLog($™¨†ë©² . $ÁÊƒ‘[1851]); } $ÎÉ×ğíÉ = is_string($è›—º«š) ? array($è›—º«š) : $è›—º«š; $öø¼µ–è = new TaskFileTransfer($ğ°Õßóş, $™¨†ë©², 0, $úÊÉ“Ëî ? $úÊÉ“Ëî : $ÎÉ×ğíÉ[0]); foreach ($ÎÉ×ğíÉ as $—ßı”»Ö) { $öø¼µ–è->addPath($—ßı”»Ö); } break; case $ÁÊƒ‘[389]: if (!$è›—º«š) { return echoLog($™¨†ë©² . $ÁÊƒ‘[1851]); } $ÎÉ×ğíÉ = is_string($è›—º«š) ? array($è›—º«š) : $è›—º«š; $öø¼µ–è = new TaskZip($ğ°Õßóş, $™¨†ë©², 0, $úÊÉ“Ëî ? $úÊÉ“Ëî : $ÎÉ×ğíÉ[0]); foreach ($ÎÉ×ğíÉ as $—ßı”»Ö) { $öø¼µ–è->addPath($—ßı”»Ö); } break; case $ÁÊƒ‘[1292]: if (!$è›—º«š) { return echoLog($™¨†ë©² . $ÁÊƒ‘[1851]); } $öø¼µ–è = new TaskUnZip($ğ°Õßóş, $™¨†ë©², 0, $úÊÉ“Ëî ? $úÊÉ“Ëî : $è›—º«š); if ($è›—º«š) { $öø¼µ–è->addFile($è›—º«š); } break; case $ÁÊƒ‘[152]: $öø¼µ–è = new TaskHttp($ğ°Õßóş, $™¨†ë©²); break; default: return; break; } $this->task = $öø¼µ–è; $this->taskID = $ğ°Õßóş; Hook::bind($ÁÊƒ‘[1786], array($this, $ÁÊƒ‘[1852])); Hook::bind($ÁÊƒ‘[1788], array($this, $ÁÊƒ‘[1853])); Hook::bind($ÁÊƒ‘[1782], array($this, $ÁÊƒ‘[1854])); echoLog($ÁÊƒ‘[1855] . $öø¼µ–è->task[$ÁÊƒ‘[1651]]); } public function __destruct() { $this->end(); } public function end($şË™ÛÛı = '') { $¶€úÔÌ‘ =& $_SERVER[ÆªÈ–¬]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($şË™ÛÛı); $this->task = !1; $this->taskID = !1; Hook::unbind($¶€úÔÌ‘[1786], array($this, $¶€úÔÌ‘[1852])); Hook::unbind($¶€úÔÌ‘[1788], array($this, $¶€úÔÌ‘[1853])); Hook::unbind($¶€úÔÌ‘[1782], array($this, $¶€úÔÌ‘[1854])); } public function taskUpdate($¡ı»âöÔ) { $ş³Î‹•› =& $_SERVER[ÆªÈ–¬]; if (!$¡ı»âöÔ || $this->taskID != $¡ı»âöÔ[$ş³Î‹•›[475]]) { return; } $ŠÈ¨•Ãû = 20; $Ó¨µ½¹Ñ = intval($¡ı»âöÔ[$ş³Î‹•›[1767]] * $ŠÈ¨•Ãû); $··­íº = $ş³Î‹•›[176] . str_repeat($ş³Î‹•›[955], $Ó¨µ½¹Ñ) . $ş³Î‹•›[1085] . str_repeat($ş³Î‹•›[53], $ŠÈ¨•Ãû - $Ó¨µ½¹Ñ) . $ş³Î‹•›[178]; $øè†® = $··­íº . sprintf($ş³Î‹•›[1856], $¡ı»âöÔ[$ş³Î‹•›[1767]] * 100) . $ş³Î‹•›[1857]; $ÌÇÈòæï = $øè†® . $¡ı»âöÔ[$ş³Î‹•›[1766]] . $ş³Î‹•›[8] . $¡ı»âöÔ[$ş³Î‹•›[1134]] . LNG($ş³Î‹•›[1858]); $«¡Ø•ò™ = $ş³Î‹•›[12]; if ($¡ı»âöÔ[$ş³Î‹•›[1842]]) { $ÌÇÈòæï = $øè†® . size_format($¡ı»âöÔ[$ş³Î‹•›[1766]]) . $ş³Î‹•›[8] . size_format($¡ı»âöÔ[$ş³Î‹•›[1134]]); $«¡Ø•ò™ = size_format($¡ı»âöÔ[$ş³Î‹•›[1768]]) . $ş³Î‹•›[1859]; } if ($¡ı»âöÔ[$ş³Î‹•›[1136]]) { $¡ı»âöÔ[$ş³Î‹•›[1816]] = $¡ı»âöÔ[$ş³Î‹•›[1136]] . $ş³Î‹•›[53] . $¡ı»âöÔ[$ş³Î‹•›[1816]]; } if ($¡ı»âöÔ[$ş³Î‹•›[1816]]) { $ç¦Ššã¯ = $ş³Î‹•›[12]; if ($¡ı»âöÔ[$ş³Î‹•›[1818]]) { $ç¦Ššã¯ = $ş³Î‹•›[50] . size_format($¡ı»âöÔ[$ş³Î‹•›[1819]]) . $ş³Î‹•›[8] . size_format($¡ı»âöÔ[$ş³Î‹•›[1818]]); } $«¡Ø•ò™ .= $¡ı»âöÔ[$ş³Î‹•›[1816]] . $ç¦Ššã¯; } if ($¡ı»âöÔ[$ş³Î‹•›[829]] && !$¡ı»âöÔ[$ş³Î‹•›[1818]]) { $«¡Ø•ò™ .= $ş³Î‹•›[53] . size_format($¡ı»âöÔ[$ş³Î‹•›[1823]]) . $ş³Î‹•›[8] . size_format($¡ı»âöÔ[$ş³Î‹•›[829]]); } echoLog($ÌÇÈòæï . $ş³Î‹•›[53] . $«¡Ø•ò™, !0); } public function taskEnd($À¼âÊùÄ) { $„é›¤•Â =& $_SERVER[ÆªÈ–¬]; if (!$À¼âÊùÄ || $this->taskID != $À¼âÊùÄ[$„é›¤•Â[475]]) { return; } $ê³‘²¹Å = $À¼âÊùÄ ? $À¼âÊùÄ[$„é›¤•Â[1766]] . $„é›¤•Â[8] . $À¼âÊùÄ[$„é›¤•Â[1134]] . LNG($„é›¤•Â[1858]) . $„é›¤•Â[74] : $„é›¤•Â[12]; echoLog($„é›¤•Â[1860] . $À¼âÊùÄ[$„é›¤•Â[1651]] . ($À¼âÊùÄ[$„é›¤•Â[526]] ? $„é›¤•Â[74] . $À¼âÊùÄ[$„é›¤•Â[526]] : $„é›¤•Â[12]) . $„é›¤•Â[74] . $ê³‘²¹Å . $„é›¤•Â[1861] . sprintf($„é›¤•Â[924], timeFloat() - $À¼âÊùÄ[$„é›¤•Â[1769]]) . $„é›¤•Â[1781]); $this->end(); } public function taskKill($œ±Ğé¼®) { $©†ª¢‚Ø =& $_SERVER[ÆªÈ–¬]; if (!$œ±Ğé¼® || $this->taskID != $œ±Ğé¼®[$©†ª¢‚Ø[475]]) { return; } echoLog($©†ª¢‚Ø[1862] . $œ±Ğé¼®[$©†ª¢‚Ø[1651]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\x51\x75\x65\x75\145\x4c\145\156\x67\x74\150"; const QUEUE_DATA = "\x74\x61\x73\153\x51\x75\x65\165\145\x44\141\x74\141"; const QUEUE_TIME = "\x74\141\163\x6b\x51\x75\145\x75\x65\114\141\163\x74\x52\x75\x6e"; const QUEUE_THREAD = "\x74\x61\x73\x6b\121\x75\x65\x75\145\x54\x68\x72\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Íßıùœ¢, $½àìÍÛ• = array(), $³¾¢àñÖ = '', $œ×ï“Æ± = '') { $ÏØÜÖ =& $_SERVER[ÆªÈ–¬]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($œ×ï“Æ± && array_find_by_field(self::$listData, $ÏØÜÖ[97], $œ×ï“Æ±)) { return !0; } if ($œ×ï“Æ± && array_find_by_field(self::$listDataAdd, $ÏØÜÖ[97], $œ×ï“Æ±)) { return !0; } self::$listDataAdd[] = array($ÏØÜÖ[341] => $Íßıùœ¢, $ÏØÜÖ[1863] => $½àìÍÛ•, $ÏØÜÖ[526] => $³¾¢àñÖ, $ÏØÜÖ[97] => $œ×ï“Æ±); return !0; } public static function addSubmit() { $£µËè½ =& $_SERVER[ÆªÈ–¬]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($£µËè½[1864] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $£µËè½[12], $£µËè½[526])), $£µËè½[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ù–úœĞ«, $˜ËÓ¤ˆµ = array(), $•™˜¬ˆÅ = '', $Šó¦¥ŠÙ = '') { $íïìûÉ° =& $_SERVER[ÆªÈ–¬]; if (self::count() >= self::MAX_LENGTH) { return !1; } $­ùÃ¡ë‘ = self::getAll(); if ($Šó¦¥ŠÙ && array_find_by_field($­ùÃ¡ë‘, $íïìûÉ°[97], $Šó¦¥ŠÙ)) { return !0; } $­ùÃ¡ë‘[] = array($íïìûÉ°[341] => $ù–úœĞ«, $íïìûÉ°[1863] => $˜ËÓ¤ˆµ, $íïìûÉ°[526] => $•™˜¬ˆÅ, $íïìûÉ°[97] => $Šó¦¥ŠÙ); self::setAll($­ùÃ¡ë‘); write_log($íïìûÉ°[1864] . $•™˜¬ˆÅ, $íïìûÉ°[197]); return !0; } public static function run() { $œÄùŒ„Ç =& $_SERVER[ÆªÈ–¬]; $ÛßÎÓœá = self::getAll(); $ı·Ä­Õ = array_shift($ÛßÎÓœá); if (!$ı·Ä­Õ) { return !1; } self::setAll($ÛßÎÓœá); $³´û‚à = timeFloat(); $üê£û¥Î = $œÄùŒ„Ç[12]; try { $üê£û¥Î = Hook::apply($ı·Ä­Õ[$œÄùŒ„Ç[341]], $ı·Ä­Õ[$œÄùŒ„Ç[1863]]); } catch (Exception $·Œ¼ò§†) { write_log($·Œ¼ò§†, $œÄùŒ„Ç[1257]); } $¦Ò÷ëÛ¶ = number_format(timeFloat() - $³´û‚à, 3) . $œÄùŒ„Ç[1781]; if ($üê£û¥Î && is_string($üê£û¥Î)) { $¦Ò÷ëÛ¶ = $¦Ò÷ëÛ¶ . $œÄùŒ„Ç[1865] . $üê£û¥Î; } write_log($œÄùŒ„Ç[1866] . $ı·Ä­Õ[$œÄùŒ„Ç[526]] . $œÄùŒ„Ç[1867] . $¦Ò÷ëÛ¶, $œÄùŒ„Ç[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ËÒÛµè¿ =& $_SERVER[ÆªÈ–¬]; $º‚Â€Ú‡ = self::threadCount() + 1; if ($º‚Â€Ú‡ > 3 || !self::count()) { return; } write_log($ËÒÛµè¿[1868] . $º‚Â€Ú‡, $ËÒÛµè¿[197]); Cache::set(self::QUEUE_THREAD, $º‚Â€Ú‡, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ËÒÛµè¿[1869], $ËÒÛµè¿[197]); } public static function getKey($²é¼†¸, $¢æ¼½Ä‰ = "\x69\156\x74") { $ÖÌ­ûÑô =& $_SERVER[ÆªÈ–¬]; Cache::removeMemory($²é¼†¸); $çã†ãàò = Cache::get($²é¼†¸); if ($¢æ¼½Ä‰ == $ÖÌ­ûÑô[364]) { return $çã†ãàò ? intval($çã†ãàò) : 0; } if ($¢æ¼½Ä‰ == $ÖÌ­ûÑô[1870]) { return is_array($çã†ãàò) ? $çã†ãàò : array(); } return $çã†ãàò; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ÆªÈ–¬][1870]); } public static function setAll($¼î) { $ãÑ¯ô‡á = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¼î), $ãÑ¯ô‡á); Cache::set(self::QUEUE_DATA, $¼î, $ãÑ¯ô‡á); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto eó×ÃÊê™Í; b£ƒĞò³–„: class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\143\145\x5f\141\165\164\x68"; public function getAuth($…­™ôğâ) { $‡Ø°ìÅ =& $_SERVER[ÆªÈ–¬]; $â‰©ƒæÆ = $this->sourceAuthSelect($…­™ôğâ); $ş¿¡ì§´ = array(); $àÜú´ñå = array(); $ÒÀ˜©ò« = 2 << 25; foreach ($â‰©ƒæÆ as $ÉÜ¯Ä¢) { $ÒĞÙæáÇ = Model($‡Ø°ìÅ[571])->listData($ÉÜ¯Ä¢[$‡Ø°ìÅ[2072]]); if (!$ÒĞÙæáÇ) { continue; } $ş¿¡ì§´[] = $ÉÜ¯Ä¢; $ß›âî® = 0; if ($ÉÜ¯Ä¢[$‡Ø°ìÅ[190]] == SourceModel::TYPE_GROUP) { $ß›âî® = $ÒÀ˜©ò« * 2; } if ($ÉÜ¯Ä¢[$‡Ø°ìÅ[190]] == SourceModel::TYPE_USER) { $ß›âî® = $ÒÀ˜©ò«; } if ($ÉÜ¯Ä¢[$‡Ø°ìÅ[190]] == SourceModel::TYPE_USER && $ÉÜ¯Ä¢[$‡Ø°ìÅ[569]] == $‡Ø°ìÅ[228]) { $ß›âî® = 0; } $àÜú´ñå[] = $ÒĞÙæáÇ[$‡Ø°ìÅ[487]] + $ß›âî®; } array_multisort($àÜú´ñå, SORT_DESC, $ş¿¡ì§´); return $ş¿¡ì§´; } public function sourceAuthSelect($ğ÷‡³ıÇ) { $–Ü¯§ç— =& $_SERVER[ÆªÈ–¬]; static $šµêÉúÇ = array(); $şúş­ø¸ = is_array($ğ÷‡³ıÇ) ? !1 : !0; if ($şúş­ø¸) { $ğ÷‡³ıÇ = array($ğ÷‡³ıÇ); } $®‹ „´ = array(); foreach ($ğ÷‡³ıÇ as $ŠÁÎè¤) { if (isset($šµêÉúÇ[$ŠÁÎè¤])) { $®‹ „´[$ŠÁÎè¤] = $šµêÉúÇ[$ŠÁÎè¤]; } } if (count($®‹ „´) == count($ğ÷‡³ıÇ)) { return $şúş­ø¸ ? $®‹ „´[$ğ÷‡³ıÇ[0]] : $®‹ „´; } $¹²Éá…İ = $–Ü¯§ç—[2149]; $¾©è¨™Â = array($–Ü¯§ç—[193] => array($–Ü¯§ç—[7], $ğ÷‡³ıÇ)); $Ì¢£Ö»Ù = $this->field($¹²Éá…İ)->order($–Ü¯§ç—[475])->where($¾©è¨™Â)->select(); $¯ØÚÈ¶ş = array_to_keyvalue_group($Ì¢£Ö»Ù, $–Ü¯§ç—[193]); foreach ($ğ÷‡³ıÇ as $ŠÁÎè¤) { $šµêÉúÇ[$ŠÁÎè¤] = $¯ØÚÈ¶ş[$ŠÁÎè¤] ? $¯ØÚÈ¶ş[$ŠÁÎè¤] : array(); } if ($şúş­ø¸) { return $Ì¢£Ö»Ù; } return $¯ØÚÈ¶ş; } public function setAuth($‚Ù‡ö¶ï, $Ñ—”•×) { $ı¤•Ù =& $_SERVER[ÆªÈ–¬]; $³®†ˆ€€ = Model($ı¤•Ù[1411])->sourceInfo($‚Ù‡ö¶ï); if (!$³®†ˆ€€) { return !1; } if ($³®†ˆ€€[$ı¤•Ù[190]] != SourceModel::TYPE_GROUP) { return !1; } $”ëûÏˆ = 1; $–àí»à = $³®†ˆ€€[$ı¤•Ù[569]]; if ($–àí»à != $”ëûÏˆ) { $Ô—¦öŒ† = array($ı¤•Ù[1964] => $–àí»à); $Õ¼ò·ñÎ = Model($ı¤•Ù[2058])->field($ı¤•Ù[1765])->where($Ô—¦öŒ†)->select(); $Õ¼ò·ñÎ = array_to_keyvalue($Õ¼ò·ñÎ, $ı¤•Ù[12], $ı¤•Ù[1765]); } $Åˆ¿ÍÁ¢ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $§âƒ˜î¬ = array(); foreach ($Ñ—”•× as $ÔÏ‡Ìƒ) { if (!in_array($ÔÏ‡Ìƒ[$ı¤•Ù[190]], $Åˆ¿ÍÁ¢)) { show_json(LNG($ı¤•Ù[2150]), !1); } if ($–àí»à != $”ëûÏˆ) { if ($ÔÏ‡Ìƒ[$ı¤•Ù[190]] == SourceModel::TYPE_GROUP) { } if ($ÔÏ‡Ìƒ[$ı¤•Ù[569]] != 0 && !in_array($ÔÏ‡Ìƒ[$ı¤•Ù[569]], $Õ¼ò·ñÎ)) { } } if ($ÔÏ‡Ìƒ[$ı¤•Ù[569]] == 0) { $ÔÏ‡Ìƒ[$ı¤•Ù[190]] = SourceModel::TYPE_USER; } $§âƒ˜î¬[] = array($ı¤•Ù[193] => $‚Ù‡ö¶ï, $ı¤•Ù[190] => intval($ÔÏ‡Ìƒ[$ı¤•Ù[190]]), $ı¤•Ù[569] => intval($ÔÏ‡Ìƒ[$ı¤•Ù[569]]), $ı¤•Ù[2072] => intval($ÔÏ‡Ìƒ[$ı¤•Ù[2072]]) ? intval($ÔÏ‡Ìƒ[$ı¤•Ù[2072]]) : 0, $ı¤•Ù[2132] => intval($ÔÏ‡Ìƒ[$ı¤•Ù[2132]]) ? intval($ÔÏ‡Ìƒ[$ı¤•Ù[2132]]) : -1); } $this->where(array($ı¤•Ù[491] => $‚Ù‡ö¶ï))->delete(); $this->addAll($§âƒ˜î¬); return !0; } public function authClear($¥º¶Œø«) { $‰óÌŒÖÔ =& $_SERVER[ÆªÈ–¬]; $Ô¾­×È = Model($‰óÌŒÖÔ[1411])->sourceInfo($¥º¶Œø«); $·•¨ªìÜ = array($¥º¶Œø«); if ($Ô¾­×È[$‰óÌŒÖÔ[485]] == $‰óÌŒÖÔ[91]) { $¦é¶‹€ñ = array($‰óÌŒÖÔ[652] => array($‰óÌŒÖÔ[612], $Ô¾­×È[$‰óÌŒÖÔ[584]] . $¥º¶Œø« . $‰óÌŒÖÔ[613])); $·•¨ªìÜ = Model($‰óÌŒÖÔ[1411])->field($‰óÌŒÖÔ[491])->where($¦é¶‹€ñ)->getField($‰óÌŒÖÔ[193], !0); $·•¨ªìÜ[] = $¥º¶Œø«; } $this->where(array($‰óÌŒÖÔ[491] => array($‰óÌŒÖÔ[492], $·•¨ªìÜ)))->delete(); return !0; } public function getAllChildren($è´œ›„²) { $ı¦¼Áş =& $_SERVER[ÆªÈ–¬]; $ÓÎòÏ•¢ = Model($ı¦¼Áş[1411])->sourceInfo($è´œ›„²); if ($ÓÎòÏ•¢[$ı¦¼Áş[485]] != $ı¦¼Áş[91]) { return $this->sourceListAuth(array($è´œ›„²)); } if ($ÓÎòÏ•¢[$ı¦¼Áş[190]] != SourceModel::TYPE_GROUP) { return array(); } $Ü†ƒÕ°Ş = 1; $ÓÀœÓœ = array($è´œ›„²); if ($ÓÎòÏ•¢[$ı¦¼Áş[192]] == $ı¦¼Áş[228] && $ÓÎòÏ•¢[$ı¦¼Áş[569]] != $Ü†ƒÕ°Ş) { $ÓÀœÓœ = $this->groupChidldAllRootSource($ÓÎòÏ•¢[$ı¦¼Áş[569]]); } $«ÈÎô¬Ï = $this->field($ı¦¼Áş[193])->group($ı¦¼Áş[193])->select(); $«ÈÎô¬Ï = array_to_keyvalue($«ÈÎô¬Ï, $ı¦¼Áş[12], $ı¦¼Áş[193]); if (!$«ÈÎô¬Ï) { return array(); } $¢œç¦˜˜ = $ı¦¼Áş[2151]; $®”àÌÁ‡ = array($ı¦¼Áş[193] => array($ı¦¼Áş[7], $«ÈÎô¬Ï), $ı¦¼Áş[505] => $ı¦¼Áş[228]); $¾ëîîüï = Model($ı¦¼Áş[890])->field($¢œç¦˜˜)->where($®”àÌÁ‡)->select(); $ÑìŒâ€ñ = array($è´œ›„²); foreach ($¾ëîîüï as $·ÆÈÛúÁ) { foreach ($ÓÀœÓœ as $åúå˜›‰) { $‰°ã•Û« = $ı¦¼Áş[50] . $åúå˜›‰ . $ı¦¼Áş[50]; $Œüù¢û¾ = $·ÆÈÛúÁ[$ı¦¼Áş[584]] . $·ÆÈÛúÁ[$ı¦¼Áş[193]] . $ı¦¼Áş[50]; if (strstr($Œüù¢û¾, $‰°ã•Û«)) { $ÑìŒâ€ñ[] = $·ÆÈÛúÁ[$ı¦¼Áş[193]]; break; } } } return $this->sourceListAuth($ÑìŒâ€ñ); } private function sourceListAuth($ØÅÅçİÖ) { $ä‘¶¶âÌ =& $_SERVER[ÆªÈ–¬]; $µªˆÇ = Model($ä‘¶¶âÌ[1411])->sourceListInfo($ØÅÅçİÖ, !0); $À¾Â »Á = $this->sourceAuthSelect($ØÅÅçİÖ); $Şı¸É¯Ç = array(); $ô´¢À›ü = array(); foreach ($µªˆÇ as $éáû´ßğ) { unset($éáû´ßğ[$ä‘¶¶âÌ[529]]); unset($éáû´ßğ[$ä‘¶¶âÌ[527]]); unset($éáû´ßğ[$ä‘¶¶âÌ[487]]); unset($éáû´ßğ[$ä‘¶¶âÌ[90]]); $Ï·¨§›  = $À¾Â »Á[$éáû´ßğ[$ä‘¶¶âÌ[193]]]; if (!$Ï·¨§› ) { continue; } $éáû´ßğ[$ä‘¶¶âÌ[2152]] = $this->authTargetInfo($Ï·¨§› ); $éáû´ßğ[$ä‘¶¶âÌ[582]] = rtrim($éáû´ßğ[$ä‘¶¶âÌ[588]], $ä‘¶¶âÌ[8]) . $ä‘¶¶âÌ[8] . ltrim($éáû´ßğ[$ä‘¶¶âÌ[582]], $ä‘¶¶âÌ[8]); $Şı¸É¯Ç[] = $éáû´ßğ; $¬ñåÔŞ© = count(explode($ä‘¶¶âÌ[8], trim($éáû´ßğ[$ä‘¶¶âÌ[582]], $ä‘¶¶âÌ[8]))); $ô´¢À›ü[] = $¬ñåÔŞ© + ($éáû´ßğ[$ä‘¶¶âÌ[33]] == $ä‘¶¶âÌ[78] ? 0 : 1000); } array_multisort($ô´¢À›ü, SORT_ASC, $Şı¸É¯Ç); return $Şı¸É¯Ç; } private function groupChidldAllRootSource($ó…ïòõş) { $Ş»…âƒ• =& $_SERVER[ÆªÈ–¬]; $„ºáŠÖå = Model($Ş»…âƒ•[2153])->groupChildrenAll($ó…ïòõş); $‰ÁÓ¨Ò = array($Ş»…âƒ•[192] => 0, $Ş»…âƒ•[569] => array($Ş»…âƒ•[7], $„ºáŠÖå), $Ş»…âƒ•[190] => SourceModel::TYPE_GROUP); $Æ˜èë³¿ = Model($Ş»…âƒ•[890])->field($Ş»…âƒ•[193])->where($‰ÁÓ¨Ò)->select(); $Æ˜èë³¿ = array_to_keyvalue($Æ˜èë³¿, $Ş»…âƒ•[12], $Ş»…âƒ•[193]); return $Æ˜èë³¿; } private function authTargetInfo($ìÔƒ‘›è) { $ÃÚï¯¤º =& $_SERVER[ÆªÈ–¬]; $™ïœİ´Ó = array(); $¾ø¨ùÈ = array(); $õ¦ö¨õ© = 2 << 25; foreach ($ìÔƒ‘›è as $å—Šê½±) { $˜ªÙÜ¸ = Model($ÃÚï¯¤º[571])->listData($å—Šê½±[$ÃÚï¯¤º[2072]]); if (!$˜ªÙÜ¸) { continue; } if ($å—Šê½±[$ÃÚï¯¤º[190]] == SourceModel::TYPE_USER) { $Ù²Ü„˜  = Model($ÃÚï¯¤º[577])->getInfoSimpleOuter($å—Šê½±[$ÃÚï¯¤º[569]]); if ($Ù²Ü„˜ [$ÃÚï¯¤º[1765]] == $ÃÚï¯¤º[1266]) { continue; } if ($Ù²Ü„˜ [$ÃÚï¯¤º[1765]] == $ÃÚï¯¤º[228]) { $Ù²Ü„˜ [$ÃÚï¯¤º[32]] = LNG($ÃÚï¯¤º[2154]); } } else { $Ù²Ü„˜  = Model($ÃÚï¯¤º[585])->getInfoSimple($å—Šê½±[$ÃÚï¯¤º[569]]); } if (!$Ù²Ü„˜ ) { continue; } $Ù²Ü„˜ [$ÃÚï¯¤º[540]] = $˜ªÙÜ¸; $™ïœİ´Ó[] = $Ù²Ü„˜ ; $½‚ı®¬ = 0; if ($å—Šê½±[$ÃÚï¯¤º[190]] == SourceModel::TYPE_GROUP) { $½‚ı®¬ = $õ¦ö¨õ© * 2; } if ($å—Šê½±[$ÃÚï¯¤º[190]] == SourceModel::TYPE_USER) { $½‚ı®¬ = $õ¦ö¨õ©; } if ($å—Šê½±[$ÃÚï¯¤º[190]] == SourceModel::TYPE_USER && $å—Šê½±[$ÃÚï¯¤º[569]] == $ÃÚï¯¤º[228]) { $½‚ı®¬ = 0; } $¾ø¨ùÈ[] = $˜ªÙÜ¸[$ÃÚï¯¤º[487]] + $½‚ı®¬; } array_multisort($¾ø¨ùÈ, SORT_DESC, $™ïœİ´Ó); return $™ïœİ´Ó; } public function getAllChildrenByUser($ÑüŞœù¿, $­Å¦œü) { $¸ŸçÅ =& $_SERVER[ÆªÈ–¬]; $ÜÊ©—™ = Model($¸ŸçÅ[598])->getInfo($­Å¦œü); if (!$­Å¦œü || !$ÑüŞœù¿ || !$ÜÊ©—™) { return array(); } $Ó‰Í¿“‘ = Model($¸ŸçÅ[1411])->sourceInfo($ÑüŞœù¿); $ÊÔ…¦¢ = array(); $İìÒ‰â = 1; if ($Ó‰Í¿“‘[$¸ŸçÅ[192]] == $¸ŸçÅ[228] && $Ó‰Í¿“‘[$¸ŸçÅ[569]] != $İìÒ‰â && $this->groupContainUser($Ó‰Í¿“‘[$¸ŸçÅ[569]], $­Å¦œü)) { foreach ($ÜÊ©—™[$¸ŸçÅ[2155]] as $Ö†şÖåë) { $†—Íá¡ƒ = Model($¸ŸçÅ[585])->getInfo($Ö†şÖåë[$¸ŸçÅ[1964]]); $ÕÓ›ÁÍÈ = Model($¸ŸçÅ[598])->getInfoSimpleOuter($­Å¦œü); $ÕÓ›ÁÍÈ[$¸ŸçÅ[540]] = $Ö†şÖåë[$¸ŸçÅ[487]]; if (Model($¸ŸçÅ[571])->authCheckAction($Ö†şÖåë[$¸ŸçÅ[487]][$¸ŸçÅ[487]], $¸ŸçÅ[1985])) { continue; } $¯á­«–á = array($¸ŸçÅ[32] => $¸ŸçÅ[1286] . $†—Íá¡ƒ[$¸ŸçÅ[32]], $¸ŸçÅ[193] => $†—Íá¡ƒ[$¸ŸçÅ[90]][$¸ŸçÅ[193]], $¸ŸçÅ[87] => KodIO::make($†—Íá¡ƒ[$¸ŸçÅ[90]][$¸ŸçÅ[193]]), $¸ŸçÅ[192] => $¸ŸçÅ[228], $¸ŸçÅ[190] => $¸ŸçÅ[578], $¸ŸçÅ[33] => $¸ŸçÅ[616], $¸ŸçÅ[582] => $†—Íá¡ƒ[$¸ŸçÅ[589]], $¸ŸçÅ[1964] => $†—Íá¡ƒ[$¸ŸçÅ[1964]], $¸ŸçÅ[586] => $†—Íá¡ƒ[$¸ŸçÅ[192]], $¸ŸçÅ[2152] => array($ÕÓ›ÁÍÈ)); $ÊÔ…¦¢[$¯á­«–á[$¸ŸçÅ[193]]] = $¯á­«–á; } } $äâ”Ÿ¯¨ = array(); $òÆ‹úÁ = $this->getAllChildren($ÑüŞœù¿); foreach ($òÆ‹úÁ as $ßØÔÃéË) { $¸Å‹Ï¬ = !1; foreach ($ßØÔÃéË[$¸ŸçÅ[2152]] as $Õ¦ı™«È) { if ($Õ¦ı™«È[$¸ŸçÅ[1765]]) { if ($Õ¦ı™«È[$¸ŸçÅ[1765]] == $­Å¦œü) { $¸Å‹Ï¬ = !0; break; } } if ($Õ¦ı™«È[$¸ŸçÅ[1964]]) { if ($this->groupContainUser($Õ¦ı™«È[$¸ŸçÅ[1964]], $­Å¦œü)) { $¸Å‹Ï¬ = !0; break; } } } if ($¸Å‹Ï¬) { $äâ”Ÿ¯¨[] = $ßØÔÃéË; } $ş››³¨Ù = $ßØÔÃéË[$¸ŸçÅ[193]]; if (isset($ÊÔ…¦¢[$ş››³¨Ù])) { $ßØÔÃéË[$¸ŸçÅ[2152]][] = $ÊÔ…¦¢[$ş››³¨Ù][0]; $ÊÔ…¦¢[$ş››³¨Ù] = !1; } } $ÊÔ…¦¢ = array_filter(array_values($ÊÔ…¦¢)); $äâ”Ÿ¯¨ = array_merge($ÊÔ…¦¢, $äâ”Ÿ¯¨); return $äâ”Ÿ¯¨; } public function setAllChildrenByUser($í»¾•Ñ·, $ªÕæúÎ¡, $’ÀÊ©) { $¥Éò»«Ï =& $_SERVER[ÆªÈ–¬]; $Æöë² = $this->getAllChildrenByUser($í»¾•Ñ·, $ªÕæúÎ¡); if (!$’ÀÊ© || !$Æöë²) { return !1; } foreach ($Æöë² as $•Ü•÷ú©) { $¢šõ”ß = array(); foreach ($•Ü•÷ú©[$¥Éò»«Ï[2152]] as $Š¯¦‹Óö) { $Ãı‘Æ½ì = $Š¯¦‹Óö[$¥Éò»«Ï[540]]; $š§ÔÜ¾‡ = $Š¯¦‹Óö[$¥Éò»«Ï[1765]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $„ÛŠ¸óä = $Š¯¦‹Óö[$¥Éò»«Ï[1765]] ? $Š¯¦‹Óö[$¥Éò»«Ï[1765]] : $Š¯¦‹Óö[$¥Éò»«Ï[1964]]; if ($Š¯¦‹Óö[$¥Éò»«Ï[1765]] && $Š¯¦‹Óö[$¥Éò»«Ï[1765]] == $ªÕæúÎ¡) { continue; } $¢šõ”ß[] = array($¥Éò»«Ï[193] => $•Ü•÷ú©[$¥Éò»«Ï[193]], $¥Éò»«Ï[190] => $š§ÔÜ¾‡, $¥Éò»«Ï[569] => intval($„ÛŠ¸óä), $¥Éò»«Ï[2072] => isset($Ãı‘Æ½ì[$¥Éò»«Ï[475]]) ? intval($Ãı‘Æ½ì[$¥Éò»«Ï[475]]) : 0, $¥Éò»«Ï[2132] => isset($Ãı‘Æ½ì[$¥Éò»«Ï[2132]]) ? intval($Ãı‘Æ½ì[$¥Éò»«Ï[2132]]) : -1); } $¢šõ”ß[] = array($¥Éò»«Ï[193] => $•Ü•÷ú©[$¥Éò»«Ï[193]], $¥Éò»«Ï[190] => SourceModel::TYPE_USER, $¥Éò»«Ï[569] => intval($ªÕæúÎ¡), $¥Éò»«Ï[2072] => intval($’ÀÊ©), $¥Éò»«Ï[2132] => -1); $this->where(array($¥Éò»«Ï[491] => $•Ü•÷ú©[$¥Éò»«Ï[193]]))->delete(); $this->addAll($¢šõ”ß); } return !0; } public function get($Ìë¶¹É™) { $‹™†•ˆ‰ = $this->getSourceList(array($Ìë¶¹É™), !0); return $‹™†•ˆ‰[0]; } public function getSourceList($Õ‘òßŞ–, $ÜÙ–Åù¯ = false, $Ñö’÷ò“ = false) { $ò·Ãå =& $_SERVER[ÆªÈ–¬]; if (!$Õ‘òßŞ–) { return array(); } $¶ø¾ôûÉ = Model($ò·Ãå[1411]); if (!$ÜÙ–Åù¯ && count($Õ‘òßŞ–) == 1) { $ÜÙ–Åù¯ = array(); $ÜÙ–Åù¯[$Õ‘òßŞ–[0]] = $¶ø¾ôûÉ->sourceInfo($Õ‘òßŞ–[0]); } if (!$ÜÙ–Åù¯) { $í¬Ù§ò“ = array($ò·Ãå[491] => array($ò·Ãå[492], $Õ‘òßŞ–)); $ÜÙ–Åù¯ = $¶ø¾ôûÉ->field($ò·Ãå[2156])->where($í¬Ù§ò“)->select(); $ÜÙ–Åù¯ = array_to_keyvalue($ÜÙ–Åù¯, $ò·Ãå[193]); } $üÃìõÀµ = $Õ‘òßŞ–; foreach ($ÜÙ–Åù¯ as $”ÚÚÖÕĞ => $€ïóéÑñ) { $ªªÅ×¸“ = $¶ø¾ôûÉ->parentLevelArray($€ïóéÑñ[$ò·Ãå[584]]); $üÃìõÀµ = array_merge($üÃìõÀµ, array($”ÚÚÖÕĞ), array_reverse($ªªÅ×¸“)); } $üÃìõÀµ = array_values(array_unique($üÃìõÀµ)); if (!$üÃìõÀµ) { return array(); } $óÔîÁ¨ = $this->sourceAuthSelect($üÃìõÀµ); $é„şü‚ş = array(); foreach ($üÃìõÀµ as $À¹½à½) { if (isset($óÔîÁ¨[$À¹½à½])) { $é„şü‚ş[$À¹½à½] = $óÔîÁ¨[$À¹½à½]; } } $ğôëûç = $this->userIsRoot($Ñö’÷ò“); $¾Ô¸Æšƒ = AuthModel::authAll(); $ÅÊÒí¿Ô = array($ò·Ãå[488] => $¾Ô¸Æšƒ, $ò·Ãå[2157] => array($ò·Ãå[493] => 0, $ò·Ãå[1970] => $¾Ô¸Æšƒ, $ò·Ãå[494] => LNG($ò·Ãå[2158]), $ò·Ãå[1987] => $ò·Ãå[2159])); $Ã«¬âš = array(); foreach ($ÜÙ–Åù¯ as $À¹½à½ => $¹Å£ı…˜) { if ($ğôëûç && $GLOBALS[$ò·Ãå[6]][$ò·Ãå[1983]]) { $Ã«¬âš[$À¹½à½] = $ÅÊÒí¿Ô; continue; } $Ã«¬âš[$À¹½à½] = $this->makeSourceAuth($¹Å£ı…˜, $é„şü‚ş, $Ñö’÷ò“); } return $Ã«¬âš; } public function authDeepCheck($­Ğè˜·©, $éüè¢ö = false) { $ô”‹èû© =& $_SERVER[ÆªÈ–¬]; $éüè¢ö = $éüè¢ö ? $éüè¢ö : USER_ID; $ÃŞÊİç£ = $this->makeAuthDeep($éüè¢ö); if (!in_array($­Ğè˜·©, $ÃŞÊİç£[$ô”‹èû©[2160]])) { return !1; } $¨ôÈş×Ì = array(); foreach ($ÃŞÊİç£[$ô”‹èû©[2161]] as $Õ…¤êÃç => $ˆ£•³ô) { if (!in_array($­Ğè˜·©, $ˆ£•³ô)) { continue; } $¨ôÈş×Ì[] = $Õ…¤êÃç; } if (!$¨ôÈş×Ì) { return !1; } $ôıÀÍ¿ = $¨ôÈş×Ì ? $¨ôÈş×Ì[0] : $­Ğè˜·©; return array($ô”‹èû©[488] => -1, $ô”‹èû©[540] => array($ô”‹èû©[493] => $ô”‹èû©[1266], $ô”‹èû©[1970] => $ô”‹èû©[228], $ô”‹èû©[494] => LNG($ô”‹èû©[2162]), $ô”‹èû©[1987] => $ô”‹èû©[2163]), $ô”‹èû©[2164] => LNG($ô”‹èû©[2165]), $ô”‹èû©[2166] => $this->sourceAuthInfo($ôıÀÍ¿)); } protected function makeAuthDeep($ğÃÛÉ´µ = false) { $Øò‡áòà =& $_SERVER[ÆªÈ–¬]; static $÷ñãëÒĞ = array(); $ğÃÛÉ´µ = $ğÃÛÉ´µ ? $ğÃÛÉ´µ : USER_ID; if (isset($÷ñãëÒĞ[$ğÃÛÉ´µ])) { return $÷ñãëÒĞ[$ğÃÛÉ´µ]; } $‰è”˜¡Ø = Model($Øò‡áòà[2167])->listData(); $ŒÓ…Òá = array(); foreach ($‰è”˜¡Ø as $áÙ“Úª€) { if ($áÙ“Úª€[$Øò‡áòà[487]] == 0 && $áÙ“Úª€[$Øò‡áòà[1986]] == $Øò‡áòà[91]) { $ŒÓ…Òá[] = $áÙ“Úª€[$Øò‡áòà[475]]; } } $„¥‘¯£ = $this->userGroupParents($ğÃÛÉ´µ); $Ã¸ŸÕòÜ = array($Øò‡áòà[190] => SourceModel::TYPE_USER, $Øò‡áòà[569] => $ğÃÛÉ´µ); if ($„¥‘¯£) { $Ã¸ŸÕòÜ = array(array($Øò‡áòà[190] => SourceModel::TYPE_USER, $Øò‡áòà[569] => $ğÃÛÉ´µ), array($Øò‡áòà[190] => SourceModel::TYPE_GROUP, $Øò‡áòà[569] => array($Øò‡áòà[492], $„¥‘¯£)), $Øò‡áòà[1071] => $Øò‡áòà[2066]); } $ÎØÔ²¾Í = $this->field($Øò‡áòà[2168])->where($Ã¸ŸÕòÜ)->select(); $½˜ÜÔ¸™ = array(); $ª‡—ú¤› = array_to_keyvalue_group($ÎØÔ²¾Í, $Øò‡áòà[193]); foreach ($ª‡—ú¤› as $ŸÕ»ù => $œäÒÊÑÅ) { $Ô†¢á²³ = $this->authArrayCheck($œäÒÊÑÅ, $ğÃÛÉ´µ); if ($Ô†¢á²³[$Øò‡áòà[488]] > 0) { $½˜ÜÔ¸™[] = $ŸÕ»ù . $Øò‡áòà[12]; } } if ($„¥‘¯£) { $©æóÁ¯ = Model($Øò‡áòà[585]); foreach ($„¥‘¯£ as $Ö‰‚ÜÃÜ) { $¾¿Îê‰ = $©æóÁ¯->getInfo($Ö‰‚ÜÃÜ); if (!$¾¿Îê‰ || !is_array($¾¿Îê‰[$Øò‡áòà[90]])) { continue; } $½˜ÜÔ¸™[] = $¾¿Îê‰[$Øò‡áòà[90]][$Øò‡áòà[193]]; } } $ñ³ó’×Ã = array(); $ŞÄú›£Ç = $„¥‘¯£; $¸ç¡Íã = Model($Øò‡áòà[1411]); $©æóÁ¯ = Model($Øò‡áòà[585]); $Ãü»Á„Ê = array(); $ô¿˜Ãø‘ = array(); $éí™¦Í = array(); $şÈ–È’ø = array(); if ($½˜ÜÔ¸™) { $ÚÕ¡ÁÏª = $¸ç¡Íã->where(array($Øò‡áòà[193] => array($Øò‡áòà[492], $½˜ÜÔ¸™)))->select(); foreach ($ÚÕ¡ÁÏª as $­Õ–ğŸ¤) { $øæÕç¼ï = $¸ç¡Íã->parentLevelArray($­Õ–ğŸ¤[$Øò‡áòà[584]]); $ñ³ó’×Ã = array_merge($ñ³ó’×Ã, $øæÕç¼ï); $ŞÄú›£Ç[] = $­Õ–ğŸ¤[$Øò‡áòà[569]]; $Ãü»Á„Ê[$­Õ–ğŸ¤[$Øò‡áòà[193]]] = $øæÕç¼ï; $ô¿˜Ãø‘[$­Õ–ğŸ¤[$Øò‡áòà[193]]] = $­Õ–ğŸ¤[$Øò‡áòà[569]]; } } $ŞÄú›£Ç = array_values(array_unique($ŞÄú›£Ç)); $ªñêñĞ = $ŞÄú›£Ç; foreach ($ªñêñĞ as $Ö‰‚ÜÃÜ) { $¾¿Îê‰ = $©æóÁ¯->getInfo($Ö‰‚ÜÃÜ); $øæÕç¼ï = $¸ç¡Íã->parentLevelArray($¾¿Îê‰[$Øò‡áòà[584]]); $ŞÄú›£Ç = array_merge($ŞÄú›£Ç, $øæÕç¼ï); } $ŞÄú›£Ç = array_values(array_unique($ŞÄú›£Ç)); foreach ($ŞÄú›£Ç as $Ö‰‚ÜÃÜ) { $¾¿Îê‰ = $©æóÁ¯->getInfo($Ö‰‚ÜÃÜ); $ñ³ó’×Ã[] = $¾¿Îê‰[$Øò‡áòà[90]][$Øò‡áòà[193]]; $éí™¦Í[$Ö‰‚ÜÃÜ] = $¾¿Îê‰[$Øò‡áòà[90]][$Øò‡áòà[193]]; $şÈ–È’ø[$Ö‰‚ÜÃÜ] = $¸ç¡Íã->parentLevelArray($¾¿Îê‰[$Øò‡áòà[584]]); } foreach ($Ãü»Á„Ê as $¬ÔÉô³š => $æ§€µ°à) { $´Ò±é¼ = $ô¿˜Ãø‘[$¬ÔÉô³š]; if (!$´Ò±é¼ || !$éí™¦Í[$´Ò±é¼]) { continue; } $ıá¢İ±è = array(); foreach ($şÈ–È’ø[$´Ò±é¼] as $Ö‰‚ÜÃÜ) { $ıá¢İ±è[] = $éí™¦Í[$Ö‰‚ÜÃÜ]; } $Ãü»Á„Ê[$¬ÔÉô³š] = array_merge($ıá¢İ±è, $æ§€µ°à); } $ñ³ó’×Ã = array_values(array_unique($ñ³ó’×Ã)); $…©¢ü¯ä = array($Øò‡áòà[2160] => $ñ³ó’×Ã, $Øò‡áòà[2161] => $Ãü»Á„Ê); $÷ñãëÒĞ[$ğÃÛÉ´µ] = $…©¢ü¯ä; return $…©¢ü¯ä; } private function makeSourceAuth($•Ó¸¼ÄÚ, $±ŒùèŒÆ, $˜–ƒÔã = false) { $üúéşˆ =& $_SERVER[ÆªÈ–¬]; $øÙ™·Æ‚ = $üúéşˆ[91]; $ã‰ ë—³ = $•Ó¸¼ÄÚ[$üúéşˆ[569]]; $œ¦äÛ†Î = $•Ó¸¼ÄÚ[$üúéşˆ[190]] == SourceModel::TYPE_GROUP; $ºú³ä˜Ô = $œ¦äÛ†Î ? $this->groupRootAuth($ã‰ ë—³, $˜–ƒÔã) : !1; if ($ºú³ä˜Ô && Model($üúéşˆ[571])->authCheckAction($ºú³ä˜Ô[$üúéşˆ[487]], $üúéşˆ[1985])) { return $this->groupAuthInfo($ºú³ä˜Ô, $ã‰ ë—³); } $¤¶ËÜƒ² = Model($üúéşˆ[1411])->parentLevelArray($•Ó¸¼ÄÚ[$üúéşˆ[584]]); $¤¶ËÜƒ² = array_merge(array($•Ó¸¼ÄÚ[$üúéşˆ[193]]), array_reverse($¤¶ËÜƒ²)); $Üƒµå““ = !1; foreach ($¤¶ËÜƒ² as $×ñĞâ÷¿) { if (!isset($±ŒùèŒÆ[$×ñĞâ÷¿])) { continue; } $Ôæßó’Œ = $this->authMake($±ŒùèŒÆ[$×ñĞâ÷¿], $˜–ƒÔã); if ($Ôæßó’Œ[$üúéşˆ[540]]) { $Üƒµå““ = $Ôæßó’Œ; break; } } if (!$œ¦äÛ†Î) { return $Üƒµå““; } if (!$Üƒµå““ && $ºú³ä˜Ô) { $Üƒµå““ = $this->groupAuthInfo($ºú³ä˜Ô, $ã‰ ë—³); } if (!$Üƒµå““) { $„ó†ÛÍÉ = Model($üúéşˆ[585])->getInfo($ã‰ ë—³); $Å¸Ÿ¦äí = explode($üúéşˆ[50], trim($„ó†ÛÍÉ[$üúéşˆ[584]], $üúéşˆ[50])); $Å¸Ÿ¦äí = array_reverse($Å¸Ÿ¦äí); foreach ($Å¸Ÿ¦äí as $øíÚĞâ) { if ($øíÚĞâ == $üúéşˆ[228] || $øíÚĞâ == $øÙ™·Æ‚) { continue; } $ÒÒ¨§‡” = $this->groupRootAuth($øíÚĞâ, $˜–ƒÔã); if (!$ÒÒ¨§‡”) { continue; } $Üƒµå““ = $this->groupAuthInfo($ÒÒ¨§‡”, $øíÚĞâ); break; } } if (!$Üƒµå““ || $Üƒµå““[$üúéşˆ[488]] <= 0) { $ÊİÜ¥Ç = $this->authDeepCheck($•Ó¸¼ÄÚ[$üúéşˆ[193]], $˜–ƒÔã); if ($ÊİÜ¥Ç) { $Üƒµå““ = $ÊİÜ¥Ç; } } return $Üƒµå““; } private function userIsRoot($·§šÎå— = false) { $‹ØõÌëç =& $_SERVER[ÆªÈ–¬]; if (!$·§šÎå— && KodUser::isRoot()) { return !0; } $øÙ°Ö§Ç = Model($‹ØõÌëç[598])->getInfo($·§šÎå—); $‡ü ó•³ = Model($‹ØõÌëç[2169])->listData($øÙ°Ö§Ç[$‹ØõÌëç[2170]]); if ($‡ü ó•³ && $‡ü ó•³[$‹ØõÌëç[575]][$‹ØõÌëç[2171]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Â›§Ë§ü) { $—ãåáı =& $_SERVER[ÆªÈ–¬]; $Ä—®€ô = Model($—ãåáı[1411]); $ÜüÌ¼ÊÑ = $Ä—®€ô->sourceInfo($Â›§Ë§ü); if (!$ÜüÌ¼ÊÑ) { return !1; } $Ä—®€ô->groupPathDisplay($ÜüÌ¼ÊÑ); $»íÖÎ¤Ä = array($ÜüÌ¼ÊÑ); $»íÖÎ¤Ä = $Ä—®€ô->_listAppendPath($»íÖÎ¤Ä); $ÜüÌ¼ÊÑ = $»íÖÎ¤Ä[0]; $“ŞòÅ®Î = $ÜüÌ¼ÊÑ[$—ãåáı[582]]; if (isset($ÜüÌ¼ÊÑ[$—ãåáı[590]])) { $ÍŞÚ½½ú = explode($—ãåáı[8], trim($ÜüÌ¼ÊÑ[$—ãåáı[582]], $—ãåáı[8])); array_shift($ÍŞÚ½½ú); $“ŞòÅ®Î = $ÜüÌ¼ÊÑ[$—ãåáı[588]] . $—ãåáı[2172] . implode($—ãåáı[8], $ÍŞÚ½½ú); } return array($—ãåáı[494] => $ÜüÌ¼ÊÑ[$—ãåáı[32]], $—ãåáı[87] => KodIO::make($ÜüÌ¼ÊÑ[$—ãåáı[193]]), $—ãåáı[2173] => $“ŞòÅ®Î); } private function groupAuthInfo($«ÊõšÇ¯, $’»é“¶Ğ) { $Åí–ıç´ =& $_SERVER[ÆªÈ–¬]; $é’æÃÎ€ = Model($Åí–ıç´[585])->getInfo($’»é“¶Ğ); return array($Åí–ıç´[2174] => intval($«ÊõšÇ¯[$Åí–ıç´[487]]), $Åí–ıç´[2157] => $«ÊõšÇ¯, $Åí–ıç´[2175] => LNG($Åí–ıç´[2176]), $Åí–ıç´[2166] => array($Åí–ıç´[494] => $é’æÃÎ€[$Åí–ıç´[32]], $Åí–ıç´[87] => KodIO::make($é’æÃÎ€[$Åí–ıç´[90]][$Åí–ıç´[193]]), $Åí–ıç´[2173] => $é’æÃÎ€[$Åí–ıç´[589]])); } protected function groupRootAuth($Ë‚ŞÒ», $¹¢—™‡á = false) { $éù¢ÌşŒ =& $_SERVER[ÆªÈ–¬]; $¹¢—™‡á = $¹¢—™‡á ? $¹¢—™‡á : USER_ID; $ÇÆÉğîã = $¹¢—™‡á . $éù¢ÌşŒ[2177] . $Ë‚ŞÒ»; static $—êâ‡Ïú = array(); if (isset($—êâ‡Ïú[$ÇÆÉğîã])) { return $—êâ‡Ïú[$ÇÆÉğîã]; } $¯Çì™Ò¶ = Model($éù¢ÌşŒ[585])->getInfo($Ë‚ŞÒ»); $‘¾‚Û¥ = $this->userGroupList($¹¢—™‡á); $œÖµœ¿Õ = isset($‘¾‚Û¥[$Ë‚ŞÒ»]) ? $‘¾‚Û¥[$Ë‚ŞÒ»][$éù¢ÌşŒ[487]] : !1; if ($œÖµœ¿Õ && Model($éù¢ÌşŒ[571])->authCheckAction($œÖµœ¿Õ[$éù¢ÌşŒ[487]], $éù¢ÌşŒ[1985])) { $—êâ‡Ïú[$ÇÆÉğîã] = $œÖµœ¿Õ; return $œÖµœ¿Õ; } $ŒéêÙ ‰ = $this->sourceAuthSelect($¯Çì™Ò¶[$éù¢ÌşŒ[90]][$éù¢ÌşŒ[193]]); $¨æ³øí” = $ŒéêÙ ‰ ? $this->authMake($ŒéêÙ ‰, $¹¢—™‡á) : !1; $ú¢¢‡İ… = $¨æ³øí” ? $¨æ³øí”[$éù¢ÌşŒ[540]] : !1; $—êâ‡Ïú[$ÇÆÉğîã] = $ú¢¢‡İ… ? $ú¢¢‡İ… : $œÖµœ¿Õ; return $—êâ‡Ïú[$ÇÆÉğîã]; } public function authOwnerApply($ñîÂ“‚˜) { $Ş… •×å =& $_SERVER[ÆªÈ–¬]; if (empty($ñîÂ“‚˜[$Ş… •×å[487]]) || isset($ñîÂ“‚˜[$Ş… •×å[2178]]) && $ñîÂ“‚˜[$Ş… •×å[2178]]) { return $ñîÂ“‚˜; } if (AuthModel::authCheckRoot($ñîÂ“‚˜[$Ş… •×å[487]][$Ş… •×å[488]])) { return $ñîÂ“‚˜; } $ĞŸæ»è = Model($Ş… •×å[1411])->parentLevelArray($ñîÂ“‚˜[$Ş… •×å[584]]); $ĞŸæ»è = array_merge(array($ñîÂ“‚˜[$Ş… •×å[193]]), array_reverse($ĞŸæ»è)); $ğõŸÊõ = $this->sourceAuthSelect($ĞŸæ»è); $ŞÙ¸‰ØŞ = array(); $Êº‹Ğ = array(); foreach ($ğõŸÊõ as $Ùæ¸ô¸Ø => $û’úãÉƒ) { $Ÿšäèµˆ = $this->authFolderOwnerUser($û’úãÉƒ); $ŞÙ¸‰ØŞ[$Ùæ¸ô¸Ø] = $Ÿšäèµˆ; $Êº‹Ğ = array_merge($Êº‹Ğ, $Ÿšäèµˆ[$Ş… •×å[662]]); if ($Ÿšäèµˆ[$Ş… •×å[2179]]) { break; } } if (count($Êº‹Ğ) == 0) { $Êº‹Ğ = $this->authFolderOwnerGroup($ñîÂ“‚˜[$Ş… •×å[569]]); } $Êº‹Ğ = array_unique($Êº‹Ğ); if (AuthModel::authCheckRoot($ñîÂ“‚˜[$Ş… •×å[487]][$Ş… •×å[488]])) { $Êº‹Ğ[] = USER_ID; } $ñîÂ“‚˜[$Ş… •×å[487]][$Ş… •×å[2180]] = Model($Ş… •×å[577])->userListInfo($Êº‹Ğ); return $ñîÂ“‚˜; } private function authFolderOwnerGroup($ğè¯Ä×•) { $²û­—°å =& $_SERVER[ÆªÈ–¬]; $É‚µâ†¯ = Model($²û­—°å[2058])->where(array($²û­—°å[1964] => $ğè¯Ä×•))->select(); $©•ıÕÓ = array(); if (!$É‚µâ†¯) { return $©•ıÕÓ; } foreach ($É‚µâ†¯ as $Ì’›ş) { $´Ã­Ï„ = $this->authInfo($Ì’›ş); if (AuthModel::authCheckRoot($´Ã­Ï„[$²û­—°å[487]])) { $©•ıÕÓ[] = $Ì’›ş[$²û­—°å[1765]]; } } return $©•ıÕÓ; } private function authFolderOwnerUser($Î‡ÜÖé) { $”‚÷šÉ® =& $_SERVER[ÆªÈ–¬]; $ÉöóÜñò = array(); $›‹Ÿ  = !1; foreach ($Î‡ÜÖé as $ÁÓùÆÄ) { $µ€²Üóã = $this->authInfo($ÁÓùÆÄ); if ($ÁÓùÆÄ[$”‚÷šÉ®[569]] == $”‚÷šÉ®[228]) { $›‹Ÿ  = !0; } if ($ÁÓùÆÄ[$”‚÷šÉ®[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($µ€²Üóã[$”‚÷šÉ®[487]])) { $ÉöóÜñò[] = $ÁÓùÆÄ[$”‚÷šÉ®[569]]; } } } return array($”‚÷šÉ®[662] => $ÉöóÜñò, $”‚÷šÉ®[2179] => $›‹Ÿ ); } public function authMake($ªÙ¨¾€ƒ, $İäÕ§Šé = false) { $Œ’ÏÃ“ã =& $_SERVER[ÆªÈ–¬]; $‡ĞŠÙŠ = $this->authArrayCheck($ªÙ¨¾€ƒ, $İäÕ§Šé); if ($‡ĞŠÙŠ[$Œ’ÏÃ“ã[2181]]) { $‡ĞŠÙŠ[$Œ’ÏÃ“ã[2181]] = $this->sourceAuthInfo($‡ĞŠÙŠ[$Œ’ÏÃ“ã[2181]]); } return $‡ĞŠÙŠ; } public function authArrayCheck($³Õ™î”, $ÀàßÚ¨£ = false) { $¾Óß›• =& $_SERVER[ÆªÈ–¬]; if (!$³Õ™î”) { return array($¾Óß›•[488] => 0, $¾Óß›•[540] => !1); } $ÀàßÚ¨£ = $ÀàßÚ¨£ ? $ÀàßÚ¨£ : USER_ID; $à¡Ö‘Ú¦ = 0; $ÚÖİ×­Ş = 0; $’Ÿ˜êß· = 0; $™³Çî¼¸ = 0; $›õÙğ˜ò = 0; $š™áÙ—Ç = 0; $­•¿¿“º = 1000; $õ°ÍË = 0; $™ÎšĞ¹¥ = 0; $¼ŒåÃÛ¯ = 0; $¤èÎóçè = 0; $º‘Ê¨Şè = array($¾Óß›•[193] => 0); foreach ($³Õ™î” as $º‘Ê¨Şè) { $Â®÷ôÒâ = $this->authInfo($º‘Ê¨Şè); if (!$Â®÷ôÒâ) { continue; } $î×ìÒÂµ = $º‘Ê¨Şè[$¾Óß›•[569]]; $¬¨ØÑÃı = intval($Â®÷ôÒâ[$¾Óß›•[487]]); if ($º‘Ê¨Şè[$¾Óß›•[190]] == SourceModel::TYPE_USER && $î×ìÒÂµ == $ÀàßÚ¨£) { $à¡Ö‘Ú¦ = !0; $’Ÿ˜êß· = $Â®÷ôÒâ; $ÚÖİ×­Ş = $¬¨ØÑÃı; } else { if ($º‘Ê¨Şè[$¾Óß›•[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($î×ìÒÂµ, $ÀàßÚ¨£)) { $™³Çî¼¸ = !0; $¦öà´‹Ï = $this->groupStepToUserGroup($î×ìÒÂµ, $ÀàßÚ¨£); if ($¦öà´‹Ï < $­•¿¿“º) { $­•¿¿“º = $¦öà´‹Ï; $›õÙğ˜ò = $¬¨ØÑÃı; $š™áÙ—Ç = $Â®÷ôÒâ; $õ°ÍË = $î×ìÒÂµ; } if ($¦öà´‹Ï == $­•¿¿“º && $¬¨ØÑÃı >= $›õÙğ˜ò) { $›õÙğ˜ò = $¬¨ØÑÃı; $š™áÙ—Ç = $Â®÷ôÒâ; $õ°ÍË = $î×ìÒÂµ; } } else { if ($î×ìÒÂµ == $¾Óß›•[228]) { $™ÎšĞ¹¥ = !0; $¤èÎóçè = $Â®÷ôÒâ; $¼ŒåÃÛ¯ = $¬¨ØÑÃı; } } } } if ($à¡Ö‘Ú¦) { $Ë®¢Ó¤œ = $ÚÖİ×­Ş; $Â®÷ôÒâ = $’Ÿ˜êß·; $«¸ˆ•Ú­ = LNG($¾Óß›•[2182]); } else { if ($™³Çî¼¸) { $Ë®¢Ó¤œ = $›õÙğ˜ò; $Â®÷ôÒâ = $š™áÙ—Ç; $ãË÷˜ûñ = Model($¾Óß›•[585])->getInfo($õ°ÍË); $«¸ˆ•Ú­ = $¾Óß›•[176] . $ãË÷˜ûñ[$¾Óß›•[589]] . $¾Óß›•[2183] . LNG($¾Óß›•[2184]); } else { if ($™ÎšĞ¹¥) { $Ë®¢Ó¤œ = $¼ŒåÃÛ¯; $Â®÷ôÒâ = $¤èÎóçè; $«¸ˆ•Ú­ = LNG($¾Óß›•[2154]); } else { $Ë®¢Ó¤œ = 0; $Â®÷ôÒâ = !1; $«¸ˆ•Ú­ = $¾Óß›•[12]; } } } $Ì¦Ëî¼é = array($¾Óß›•[2174] => intval($Ë®¢Ó¤œ), $¾Óß›•[2157] => $Â®÷ôÒâ, $¾Óß›•[2175] => $«¸ˆ•Ú­, $¾Óß›•[2166] => $º‘Ê¨Şè[$¾Óß›•[193]]); return $Ì¦Ëî¼é; } private function groupContainUser($ÕäÒ¶ŠÊ, $òÛï®üÂ = false) { return in_array($ÕäÒ¶ŠÊ, $this->userGroupParents($òÛï®üÂ)); } private function groupStepToUserGroup($Å›¨¤Ëö, $çÓ¡£¬¡ = false) { $Œá©ğ =& $_SERVER[ÆªÈ–¬]; $ŸÄâê• = $this->userGroupList($çÓ¡£¬¡); $£ƒ‹è› = 1000; $­”ğÚ£ = $GLOBALS[$Œá©ğ[6]][$Œá©ğ[92]][$Œá©ğ[2071]] == 1; $˜‚”Î¸ì = $­”ğÚ£ ? 3 : 2; foreach ($ŸÄâê• as $¬óó³ü) { if ($¬óó³ü[$Œá©ğ[1964]] == $Å›¨¤Ëö) { return 0; } $†şÄÉöÑ = explode($Œá©ğ[50], trim($¬óó³ü[$Œá©ğ[584]], $Œá©ğ[50])); if ($†şÄÉöÑ[0] == $Œá©ğ[228] && count($†şÄÉöÑ) > $˜‚”Î¸ì) { $ú•Õ½é = array_reverse(array_slice($†şÄÉöÑ, $˜‚”Î¸ì)); $æû‚‚ßÉ = array_search($Å›¨¤Ëö, $ú•Õ½é); if ($æû‚‚ßÉ !== !1 && $æû‚‚ßÉ + 1 <= $£ƒ‹è›) { $£ƒ‹è› = $æû‚‚ßÉ + 1; } } } return $£ƒ‹è›; } private function userGroupList($Ş†‰Á¼ = false) { $¤†€ÅÒÊ =& $_SERVER[ÆªÈ–¬]; static $ÕÑ©¦Ê = array(); if (isset($ÕÑ©¦Ê[$Ş†‰Á¼])) { return $ÕÑ©¦Ê[$Ş†‰Á¼]; } $Ö¡ Áå¹ = Model($¤†€ÅÒÊ[598])->getInfo($Ş†‰Á¼); $ÕÑ©¦Ê[$Ş†‰Á¼] = array_to_keyvalue($Ö¡ Áå¹[$¤†€ÅÒÊ[2155]], $¤†€ÅÒÊ[1964]); return $ÕÑ©¦Ê[$Ş†‰Á¼]; } public function userGroupParents($Ş˜‘…Êˆ) { $™²’„Ã =& $_SERVER[ÆªÈ–¬]; static $êìü…¿ô = array(); $Ş˜‘…Êˆ = $Ş˜‘…Êˆ ? $Ş˜‘…Êˆ : USER_ID; if (isset($êìü…¿ô[$Ş˜‘…Êˆ])) { return $êìü…¿ô[$Ş˜‘…Êˆ]; } $¹Ô¾öÒò = $this->userGroupList($Ş˜‘…Êˆ); $¹êĞ†ç = array(); $ÑòÎôÖŞ = $GLOBALS[$™²’„Ã[6]][$™²’„Ã[92]][$™²’„Ã[2071]] == 1; $‰¡‡´Í = $ÑòÎôÖŞ ? 3 : 2; foreach ($¹Ô¾öÒò as $©Í×ğ£Ñ) { $ÌÒÄá¥Ç = array($©Í×ğ£Ñ[$™²’„Ã[1964]]); $ÍĞ¨¶Í» = explode($™²’„Ã[50], trim($©Í×ğ£Ñ[$™²’„Ã[584]], $™²’„Ã[50])); if ($ÍĞ¨¶Í»[0] == $™²’„Ã[228] && count($ÍĞ¨¶Í») > $‰¡‡´Í) { $ú¨ÏØ¾û = array_slice($ÍĞ¨¶Í», $‰¡‡´Í); $ÌÒÄá¥Ç = array_merge($ÌÒÄá¥Ç, array_reverse($ú¨ÏØ¾û)); } $¹êĞ†ç = array_merge($¹êĞ†ç, $ÌÒÄá¥Ç); } $êìü…¿ô[$Ş˜‘…Êˆ] = array_unique($¹êĞ†ç); return $êìü…¿ô[$Ş˜‘…Êˆ]; } public function authTargetInfoMake($’ƒÄÎ–²) { $ŞÊÍóµÀ =& $_SERVER[ÆªÈ–¬]; $²©œºëõ = array(); $¾°¾™¨Ú = array(); foreach ($’ƒÄÎ–² as $ŠÁ„œ‰) { if ($ŠÁ„œ‰[$ŞÊÍóµÀ[190]] == SourceModel::TYPE_USER) { $²©œºëõ[] = intval($ŠÁ„œ‰[$ŞÊÍóµÀ[569]]); } else { if ($ŠÁ„œ‰[$ŞÊÍóµÀ[190]] == SourceModel::TYPE_GROUP) { $¾°¾™¨Ú[] = intval($ŠÁ„œ‰[$ŞÊÍóµÀ[569]]); } } } if ($²©œºëõ) { $²©œºëõ = Model($ŞÊÍóµÀ[577])->userListInfo($²©œºëõ); } if ($¾°¾™¨Ú) { $¹¿ ù§¾ = array($ŞÊÍóµÀ[2056] => array($ŞÊÍóµÀ[492], $¾°¾™¨Ú)); $¾°¾™¨Ú = Model($ŞÊÍóµÀ[585])->field($ŞÊÍóµÀ[2185])->where($¹¿ ù§¾)->select(); $¾°¾™¨Ú = array_to_keyvalue($¾°¾™¨Ú, $ŞÊÍóµÀ[1964]); } return array($ŞÊÍóµÀ[2186] => $²©œºëõ, $ŞÊÍóµÀ[2187] => $¾°¾™¨Ú); } public function authInfo($Èù§ºù˜) { $ãñ„¼»à =& $_SERVER[ÆªÈ–¬]; if ($Èù§ºù˜[$ãñ„¼»à[2072]]) { $éÛœéºï = Model($ãñ„¼»à[571])->listData($Èù§ºù˜[$ãñ„¼»à[2072]]); if (!$éÛœéºï) { return !1; $Òç­óöš = Model($ãñ„¼»à[571])->listData(); $¾‚ÄÖ¿ğ = array_filter_by_field($Òç­óöš, $ãñ„¼»à[487], $ãñ„¼»à[228]); return $¾‚ÄÖ¿ğ; } $À‹À×ä· = array_field_key($éÛœéºï, array($ãñ„¼»à[475], $ãñ„¼»à[32], $ãñ„¼»à[487], $ãñ„¼»à[1987], $ãñ„¼»à[1988])); $À‹À×ä·[$ãñ„¼»à[2188]] = $Èù§ºù˜; return $À‹À×ä·; } else { return array($ãñ„¼»à[493] => 0, $ãñ„¼»à[1970] => $Èù§ºù˜[$ãñ„¼»à[2132]], $ãñ„¼»à[494] => $ãñ„¼»à[12], $ãñ„¼»à[1987] => $ãñ„¼»à[2189]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\162\x63\x65\137\x65\166\145\156\x74"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\124\151\x6d\x65", "\164\x69\x6d\145", "\151\x6e\x73\145\162\x74", "\146\x75\x6e\143\164\151\x6f\x6e"), array("\144\x65\x73\x63", '', "\x69\x6e\x73\145\162\164\x2c\165\x70\x64\x61\x74\x65\x2c\x73\x65\154\145\x63\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($İ§Üâ›ê, $ÓÄœÉûÏ, $¹ìœíºà = '') { $ËíÕù =& $_SERVER[ÆªÈ–¬]; if (!$this->eventSave) { return; } $åªğïá = Model($ËíÕù[1411])->sourceInfo($İ§Üâ›ê); if (!$åªğïá) { return !1; } if ($this->isDisableEvent($åªğïá, $ÓÄœÉûÏ)) { return; } if ($¹ìœíºà && is_string($¹ìœíºà)) { $¹ìœíºà = array($ËíÕù[2003] => $¹ìœíºà); } $÷—»™¾½ = defined($ËíÕù[2190]) ? USER_ID : 0; $çÄÙ¨à× = array($ËíÕù[491] => $İ§Üâ›ê, $ËíÕù[2191] => $åªğïá[$ËíÕù[192]], $ËíÕù[2192] => $åªğïá[$ËíÕù[32]], $ËíÕù[582] => !empty($åªğïá[$ËíÕù[582]]) ? $åªğïá[$ËíÕù[582]] : $ËíÕù[12], $ËíÕù[1756] => $÷—»™¾½, $ËíÕù[496] => $ÓÄœÉûÏ, $ËíÕù[1758] => $¹ìœíºà); $this->addSystemLog($ÓÄœÉûÏ, $çÄÙ¨à×); unset($çÄÙ¨à×[$ËíÕù[2192]], $çÄÙ¨à×[$ËíÕù[582]]); return $this->add($çÄÙ¨à×); } private function addSystemLog($Šª’­Ü, $ÔÑ¾ó¸) { $¢ÎÄ¢¢› =& $_SERVER[ÆªÈ–¬]; if ($Šª’­Ü == $¢ÎÄ¢¢›[2193]) { $Šª’­Ü = $ÔÑ¾ó¸[$¢ÎÄ¢¢›[526]][$¢ÎÄ¢¢›[2194]]; } else { if (in_array($Šª’­Ü, array($¢ÎÄ¢¢›[1943], $¢ÎÄ¢¢›[2195]))) { $Šª’­Ü = $ÔÑ¾ó¸[$¢ÎÄ¢¢›[526]][$¢ÎÄ¢¢›[171]]; } } $ôË–”Ğô = array_merge($ÔÑ¾ó¸, array($¢ÎÄ¢¢›[2196] => $ÔÑ¾ó¸[$¢ÎÄ¢¢›[193]], $¢ÎÄ¢¢›[2197] => $ÔÑ¾ó¸[$¢ÎÄ¢¢›[2197]])); Hook::trigger($¢ÎÄ¢¢›[2198], $¢ÎÄ¢¢›[2199] . $Šª’­Ü, $ÔÑ¾ó¸); Model($¢ÎÄ¢¢›[1907])->addLog($¢ÎÄ¢¢›[2199] . $Šª’­Ü, $ôË–”Ğô); } private function isDisableEvent($±†ÆíÑ, $äêß´•Ò) { $©ÚıÄ =& $_SERVER[ÆªÈ–¬]; if ($±†ÆíÑ[$©ÚıÄ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($äêß´•Ò == $©ÚıÄ[1932]) { return !1; } return !0; } public function eventCreate($ÏƒŠà†—, $ü¯¼ÌŞ) { $ØÖÛ×Â— =& $_SERVER[ÆªÈ–¬]; $†å·çø’ = Model($ØÖÛ×Â—[1411])->sourceInfo($ÏƒŠà†—); $½ø˜Ó½ = array($ØÖÛ×Â—[2194] => $ü¯¼ÌŞ, $ØÖÛ×Â—[32] => $†å·çø’[$ØÖÛ×Â—[32]]); return $this->addEvent($ÏƒŠà†—, $ØÖÛ×Â—[2193], $½ø˜Ó½); } public function eventFileEdit($—ŠÊ®) { $Œ¦¸¯…“ =& $_SERVER[ÆªÈ–¬]; $ÍäÃÕÓñ = array($Œ¦¸¯…“[2200] => $_SERVER[$Œ¦¸¯…“[2201]], $Œ¦¸¯…“[2202] => strtolower(ACTION)); if (isset($GLOBALS[$Œ¦¸¯…“[7]][$Œ¦¸¯…“[2203]])) { $ÍäÃÕÓñ[$Œ¦¸¯…“[2203]] = $Œ¦¸¯…“[91]; } return $this->addEvent($—ŠÊ®, $Œ¦¸¯…“[1933], $ÍäÃÕÓñ); } public function eventRecycle($¡àü³Éõ, $Ô¶ÈÒ¿) { return $this->addEvent($¡àü³Éõ, $_SERVER[ÆªÈ–¬][2195], $Ô¶ÈÒ¿); } private static $_removeLast = ''; public function eventRemove($¸â»ÉüÙ) { $‚®¯«ôœ =& $_SERVER[ÆªÈ–¬]; self::$_removeLast = $¸â»ÉüÙ; $ÅÊÙş¯ù = Model($‚®¯«ôœ[1411])->sourceInfo($¸â»ÉüÙ); $ãÊŒ¡õ = array_field_key($ÅÊÙş¯ù, array($‚®¯«ôœ[193], $‚®¯«ôœ[541], $‚®¯«ôœ[505], $‚®¯«ôœ[584])); $é‰ààÆ¹ = array($‚®¯«ôœ[171] => $ÅÊÙş¯ù[$‚®¯«ôœ[32]], $‚®¯«ôœ[2202] => ACTION, $‚®¯«ôœ[2204] => $ãÊŒ¡õ); return $this->addEvent($ÅÊÙş¯ù[$‚®¯«ôœ[192]], $‚®¯«ôœ[1932], $é‰ààÆ¹); } public function eventShare($ò÷ç¸, $ºËé³â) { return $this->addEvent($ò÷ç¸, $_SERVER[ÆªÈ–¬][1943], $ºËé³â); } public function eventMove($ğÄÒÆÊ, $ÚéÁÖçï, $¯ñìµˆî) { $Ç‘ü½ë =& $_SERVER[ÆªÈ–¬]; if (self::$_removeLast == $ğÄÒÆÊ) { return; } $Ÿ’ø›¦ß = Model($Ç‘ü½ë[1411]); $Æà´‡¤± = $Ÿ’ø›¦ß->sourceInfo($ğÄÒÆÊ); $«´©ó¸§ = $Ÿ’ø›¦ß->sourceInfo($ÚéÁÖçï); $×àÎî§å = $Ÿ’ø›¦ß->sourceInfo($¯ñìµˆî); $ˆ¨ßø—º = array($Ç‘ü½ë[1234] => $ÚéÁÖçï, $Ç‘ü½ë[2205] => $«´©ó¸§[$Ç‘ü½ë[32]], $Ç‘ü½ë[2181] => !empty($«´©ó¸§[$Ç‘ü½ë[582]]) ? $«´©ó¸§[$Ç‘ü½ë[582]] : $Ç‘ü½ë[12], $Ç‘ü½ë[1235] => $¯ñìµˆî, $Ç‘ü½ë[2206] => $×àÎî§å[$Ç‘ü½ë[32]], $Ç‘ü½ë[2207] => !empty($×àÎî§å[$Ç‘ü½ë[582]]) ? $×àÎî§å[$Ç‘ü½ë[582]] : $Ç‘ü½ë[12]); $this->addEvent($ğÄÒÆÊ, $Ç‘ü½ë[620], $ˆ¨ßø—º); $Æà´‡¤± = $Ÿ’ø›¦ß->sourceInfo($ğÄÒÆÊ); $ˆ¨ßø—º = array($Ç‘ü½ë[193] => $Æà´‡¤±[$Ç‘ü½ë[193]], $Ç‘ü½ë[32] => $Æà´‡¤±[$Ç‘ü½ë[32]]); $this->addEvent($ÚéÁÖçï, $Ç‘ü½ë[2208], $ˆ¨ßø—º); } public function eventCopy($ñ“Œå¾€) { $this->eventCreate($ñ“Œå¾€, $_SERVER[ÆªÈ–¬][618]); } public function eventRename($ıüÄ’£, $»»ñÔ¤, $™§ŸšÕ) { $”¡Ø–öê =& $_SERVER[ÆªÈ–¬]; $¬ô‡æ²„ = array($”¡Ø–öê[1234] => $»»ñÔ¤, $”¡Ø–öê[1235] => $™§ŸšÕ); return $this->addEvent($ıüÄ’£, $”¡Ø–öê[1425], $¬ô‡æ²„); } public function eventAddComment($üæ±ï‚Ï, $œ€Ó“Î) { return $this->addEvent($üæ±ï‚Ï, $_SERVER[ÆªÈ–¬][2209], $œ€Ó“Î); } public function eventAddDesc($å‰…Àú°, $Ïï•şÒá) { return $this->addEvent($å‰…Àú°, $_SERVER[ÆªÈ–¬][2210], $Ïï•şÒá); } public function listBySource($‰“ˆí’) { $Ìââ´Á’ =& $_SERVER[ÆªÈ–¬]; $Òß·Ø¿  = Model($Ìââ´Á’[1411])->sourceInfo($‰“ˆí’); $ßèÈŒğÜ = array($Ìââ´Á’[491] => $‰“ˆí’); if ($Òß·Ø¿ [$Ìââ´Á’[485]] == $Ìââ´Á’[91]) { $œÚá–“š = Model($Ìââ´Á’[1411])->listSearchChildren($‰“ˆí’, 20000); $œÚá–“š[] = $‰“ˆí’ . $Ìââ´Á’[454]; $ßèÈŒğÜ = array($Ìââ´Á’[193] => array($Ìââ´Á’[7], $œÚá–“š)); } $ÃÑÅáû = $this->where($ßèÈŒğÜ)->order($Ìââ´Á’[2211])->selectPage(); if ($ÃÑÅáû[$Ìââ´Á’[442]][$Ìââ´Á’[443]] == 0) { $ÃÑÅáû[$Ìââ´Á’[442]][$Ìââ´Á’[443]] = 1; $ÃÑÅáû[$Ìââ´Á’[445]] = array(array($Ìââ´Á’[491] => $‰“ˆí’, $Ìââ´Á’[2191] => $Òß·Ø¿ [$Ìââ´Á’[192]], $Ìââ´Á’[1756] => $Òß·Ø¿ [$Ìââ´Á’[527]], $Ìââ´Á’[496] => $Ìââ´Á’[2212], $Ìââ´Á’[497] => $Òß·Ø¿ [$Ìââ´Á’[231]], $Ìââ´Á’[1758] => $Ìââ´Á’[12])); } return $this->eventListParse($ÃÑÅáû, $‰“ˆí’); } private function eventListParse($‡ˆĞ°‡, $­Ô‚óÄ) { $ÙƒÙÓ‚† =& $_SERVER[ÆªÈ–¬]; $§Ó¤£ã = $‡ˆĞ°‡[$ÙƒÙÓ‚†[445]]; $šßµºœ = array_to_keyvalue($§Ó¤£ã, $ÙƒÙÓ‚†[12], $ÙƒÙÓ‚†[193]); $À‰İ¯† = array_to_keyvalue($§Ó¤£ã, $ÙƒÙÓ‚†[12], $ÙƒÙÓ‚†[2197]); foreach ($§Ó¤£ã as $‘¥‘ãú•) { $î’’ùùã = $‘¥‘ãú•[$ÙƒÙÓ‚†[526]]; if ($‘¥‘ãú•[$ÙƒÙÓ‚†[33]] == $ÙƒÙÓ‚†[620] && isset($î’’ùùã[$ÙƒÙÓ‚†[1234]])) { $šßµºœ[] = $î’’ùùã[$ÙƒÙÓ‚†[1234]] . $ÙƒÙÓ‚†[12]; $šßµºœ[] = $î’’ùùã[$ÙƒÙÓ‚†[1235]] . $ÙƒÙÓ‚†[12]; } if ($‘¥‘ãú•[$ÙƒÙÓ‚†[33]] == $ÙƒÙÓ‚†[2208] && isset($î’’ùùã[$ÙƒÙÓ‚†[193]])) { $šßµºœ[] = $î’’ùùã[$ÙƒÙÓ‚†[193]] . $ÙƒÙÓ‚†[12]; } } $šßµºœ = array_merge($šßµºœ, $À‰İ¯†, array($­Ô‚óÄ . $ÙƒÙÓ‚†[12])); $šßµºœ = array_unique($šßµºœ); $ª±ªä‰” = array_unique(array_to_keyvalue($§Ó¤£ã, $ÙƒÙÓ‚†[12], $ÙƒÙÓ‚†[1765])); $¢æÍ¨Ôã = Model($ÙƒÙÓ‚†[598])->userListInfo($ª±ªä‰”); $òœ¨”ì = Model($ÙƒÙÓ‚†[890])->sourceListInfo($šßµºœ, !0); foreach ($§Ó¤£ã as &$‘¥‘ãú•) { if ($‘¥‘ãú•[$ÙƒÙÓ‚†[33]] == $ÙƒÙÓ‚†[620] && isset($‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[1234]])) { $‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[1234]] = $òœ¨”ì[$‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[1234]]]; $‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[1235]] = $òœ¨”ì[$‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[1235]]]; } if ($‘¥‘ãú•[$ÙƒÙÓ‚†[33]] == $ÙƒÙÓ‚†[2208] && isset($‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[193]])) { $‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[193]] = $òœ¨”ì[$‘¥‘ãú•[$ÙƒÙÓ‚†[526]][$ÙƒÙÓ‚†[193]]]; } $‘¥‘ãú•[$ÙƒÙÓ‚†[90]] = $òœ¨”ì[$‘¥‘ãú•[$ÙƒÙÓ‚†[193]]]; $‘¥‘ãú•[$ÙƒÙÓ‚†[2213]] = $òœ¨”ì[$‘¥‘ãú•[$ÙƒÙÓ‚†[2197]]]; if ($‘¥‘ãú•[$ÙƒÙÓ‚†[33]] == $ÙƒÙÓ‚†[1932]) { $‘¥‘ãú•[$ÙƒÙÓ‚†[2213]] = $‘¥‘ãú•[$ÙƒÙÓ‚†[90]]; $‘¥‘ãú•[$ÙƒÙÓ‚†[2197]] = $‘¥‘ãú•[$ÙƒÙÓ‚†[2213]][$ÙƒÙÓ‚†[193]]; $‘¥‘ãú•[$ÙƒÙÓ‚†[90]] = !1; $‘¥‘ãú•[$ÙƒÙÓ‚†[193]] = $ÙƒÙÓ‚†[12]; } $‘¥‘ãú•[$ÙƒÙÓ‚†[2140]] = $¢æÍ¨Ôã[$‘¥‘ãú•[$ÙƒÙÓ‚†[1765]]]; } unset($‘¥‘ãú•); $‡ˆĞ°‡[$ÙƒÙÓ‚†[445]] = $§Ó¤£ã; return $‡ˆĞ°‡; } public function removeBySource($ÙÖı˜„†) { $É“¿«ë« = array($_SERVER[ÆªÈ–¬][491] => $ÙÖı˜„†); $this->where($É“¿«ë«)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\x63\145\x5f\x68\x69\x73\x74\x6f\162\171"; public function historyCount($áÂ’ñê›) { $è­šŠÚ» =& $_SERVER[ÆªÈ–¬]; if (!$áÂ’ñê›) { return array(); } if (is_string($áÂ’ñê›) || is_int($áÂ’ñê›)) { $áÂ’ñê› = array($áÂ’ñê›); } $Üşã˜ÂË = array($è­šŠÚ»[193], $è­šŠÚ»[1997] => $è­šŠÚ»[565]); $Ç·ÕùÀ² = array($è­šŠÚ»[193] => array($è­šŠÚ»[7], $áÂ’ñê›)); $û¸õ•— = $this->field($Üşã˜ÂË)->where($Ç·ÕùÀ²)->group($è­šŠÚ»[193])->select(); return array_to_keyvalue($û¸õ•—, $è­šŠÚ»[193], $è­šŠÚ»[565]); } public function addHistory($«ÁÇ¼òú, $û¬Ô«Ò = '') { $¸â’—›Ä =& $_SERVER[ÆªÈ–¬]; $°”¢Ïø´ = array($¸â’—›Ä[491] => $«ÁÇ¼òú[$¸â’—›Ä[193]], $¸â’—›Ä[1756] => isset($«ÁÇ¼òú[$¸â’—›Ä[529]]) ? $«ÁÇ¼òú[$¸â’—›Ä[529]] : $«ÁÇ¼òú[$¸â’—›Ä[527]], $¸â’—›Ä[542] => $«ÁÇ¼òú[$¸â’—›Ä[541]], $¸â’—›Ä[617] => $«ÁÇ¼òú[$¸â’—›Ä[79]], $¸â’—›Ä[2214] => $û¬Ô«Ò); if ($GLOBALS[$¸â’—›Ä[6]][$¸â’—›Ä[92]][$¸â’—›Ä[1295]] >= 1) { $this->historyAutoClear($°”¢Ïø´[$¸â’—›Ä[193]]); $this->add($°”¢Ïø´); } Hook::trigger($¸â’—›Ä[2215], $°”¢Ïø´); Model($¸â’—›Ä[2216])->eventFileEdit($«ÁÇ¼òú[$¸â’—›Ä[193]]); } private function historyAutoClear($—‘÷™¢“) { $Ğ†‰¼ª =& $_SERVER[ÆªÈ–¬]; $ŠÄÊ ˜æ = Model($Ğ†‰¼ª[836])->get($Ğ†‰¼ª[1317]); $áÄâ¤õ¸ = intval($GLOBALS[$Ğ†‰¼ª[6]][$Ğ†‰¼ª[92]][$Ğ†‰¼ª[1295]]); $æ•¬ĞË = $ŠÄÊ ˜æ == $Ğ†‰¼ª[1318] ? min(5, $áÄâ¤õ¸) : $áÄâ¤õ¸; $æ•¬ĞË = $æ•¬ĞË <= 0 ? 0 : $æ•¬ĞË - 1; if ($æ•¬ĞË >= 499) { return; } $¦½ÄÍı˜ = array($Ğ†‰¼ª[491] => $—‘÷™¢“); $Æšà˜Æ¤ = $this->field($Ğ†‰¼ª[2217])->where($¦½ÄÍı˜)->order($Ğ†‰¼ª[2211])->select(); if (!$Æšà˜Æ¤ || $æ•¬ĞË >= count($Æšà˜Æ¤)) { return; } $º‹™´Áù = array_to_keyvalue($Æšà˜Æ¤, $Ğ†‰¼ª[12], $Ğ†‰¼ª[475]); $º‹™´Áù = array_slice($º‹™´Áù, $æ•¬ĞË); $™Í°İé² = array_to_keyvalue($Æšà˜Æ¤, $Ğ†‰¼ª[12], $Ğ†‰¼ª[541]); $™Í°İé² = array_slice($™Í°İé², $æ•¬ĞË); if (!$º‹™´Áù || !$™Í°İé²) { return; } $¦½ÄÍı˜ = array($Ğ†‰¼ª[493] => array($Ğ†‰¼ª[7], $º‹™´Áù)); $this->where($¦½ÄÍı˜)->delete(); Model($Ğ†‰¼ª[544])->remove($™Í°İé²); } public function listData($é¶‹ÚÇ©) { $µ›µ“ =& $_SERVER[ÆªÈ–¬]; $‡Î¢œ¤ï = array($µ›µ“[491] => $é¶‹ÚÇ©); $”ñäÏË = $µ›µ“[2218]; $÷ò÷á = $this->field($”ñäÏË)->where($‡Î¢œ¤ï)->order($µ›µ“[2211])->selectPage(); $this->_listAppendUser($÷ò÷á[$µ›µ“[445]]); $Â–›ñÓø = Model($µ›µ“[836])->get($µ›µ“[1317]); $çª•¯†Š = 5; if ($Â–›ñÓø == $µ›µ“[1318]) { $÷ò÷á[$µ›µ“[445]] = array_slice($÷ò÷á[$µ›µ“[445]], 0, $çª•¯†Š); $÷ò÷á[$µ›µ“[442]] = array($µ›µ“[2219] => 1, $µ›µ“[2220] => 20, $µ›µ“[2221] => 1, $µ›µ“[2222] => count($÷ò÷á[$µ›µ“[445]])); } return $÷ò÷á; } protected function _listAppendUser(&$ïŞáµÏß) { $³…úÆ„ï =& $_SERVER[ÆªÈ–¬]; $Ğ“´×éÃ = array_to_keyvalue($ïŞáµÏß, $³…úÆ„ï[12], $³…úÆ„ï[1765]); $ÛÅÉî© = Model($³…úÆ„ï[598])->userListInfo($Ğ“´×éÃ); foreach ($ïŞáµÏß as &$À†³³í°) { $„é€Ëö™ = $À†³³í°[$³…úÆ„ï[1765]]; $À†³³í°[$³…úÆ„ï[527]] = $ÛÅÉî©[$„é€Ëö™] ? $ÛÅÉî©[$„é€Ëö™] : !1; } unset($À†³³í°); } public function fileInfo($ ¨šíË) { $Éñò½÷¬ =& $_SERVER[ÆªÈ–¬]; $¥¯÷¬ıš = $this->tablePrefix; $ôÉ–üİ = "{$¥¯÷¬ıš}\x69\157\137\146\151\x6c\145\x20\x66\151\154\x65\x73\x20\157\x6e\40\146\151\154\x65\163\56\x66\151\154\x65\111\104\40\x3d\40\150\x69\x73\x74\x6f\162\x79\56\146\151\154\x65\x49\104"; return $this->alias($Éñò½÷¬[2223])->where(array($Éñò½÷¬[493] => $ ¨šíË))->join($ôÉ–üİ, $Éñò½÷¬[2224])->find(); } public function removeItem($°»­÷ºı) { $²‰Ğµ´ =& $_SERVER[ÆªÈ–¬]; $”äæèÛ = array($²‰Ğµ´[493] => $°»­÷ºı); $€Á¤ñÀÎ = $this->where($”äæèÛ)->find(); if ($€Á¤ñÀÎ) { $ˆ†úÖ˜ = $this->where($”äæèÛ)->delete(); Model($²‰Ğµ´[544])->remove($€Á¤ñÀÎ[$²‰Ğµ´[541]]); return $ˆ†úÖ˜; } return !1; } public function removeBySource($Äï–ù°Ò) { $¢êÑôŠ =& $_SERVER[ÆªÈ–¬]; if (!$Äï–ù°Ò) { return !1; } if (!is_array($Äï–ù°Ò)) { $Äï–ù°Ò = array($Äï–ù°Ò); } $¿‘®‹İ¬ = array($¢êÑôŠ[491] => array($¢êÑôŠ[7], $Äï–ù°Ò)); $á©Ëåîá = $this->field($¢êÑôŠ[542])->where($¿‘®‹İ¬)->select(); if ($á©Ëåîá) { $this->where($¿‘®‹İ¬)->delete(); $·ç¡ö» = array_to_keyvalue($á©Ëåîá, $¢êÑôŠ[12], $¢êÑôŠ[541]); Model($¢êÑôŠ[544])->remove($·ç¡ö»); } return !0; } public function setDetail($êö†ô¸Â, $¦¥öíËú) { $¼÷òÜÓå =& $_SERVER[ÆªÈ–¬]; return $this->where(array($¼÷òÜÓå[493] => $êö†ô¸Â))->save(array($¼÷òÜÓå[2214] => $¦¥öíËú)); } public function rollbackToItem($çÆÏ§±, $¬¼’ã’Ú) { $òşÂò‘ =& $_SERVER[ÆªÈ–¬]; $‡óŸ‡òÁ = Model($òşÂò‘[890])->sourceInfo($çÆÏ§±); $this->addHistory($‡óŸ‡òÁ, LNG($òşÂò‘[2225])); $°›Ñ·üÃ = $this->find($¬¼’ã’Ú); $€×ş•´÷ = array($òşÂò‘[541] => $°›Ñ·üÃ[$òşÂò‘[541]], $òşÂò‘[79] => $°›Ñ·üÃ[$òşÂò‘[79]], $òşÂò‘[88] => time(), $òşÂò‘[529] => USER_ID); Model($òşÂò‘[890])->where(array($òşÂò‘[193] => $çÆÏ§±))->save($€×ş•´÷); return $this->where(array($òşÂò‘[493] => $¬¼’ã’Ú))->delete(); } public function clearSame($Ù¤İñ°‹) { $ùÁ‹€¸« =& $_SERVER[ÆªÈ–¬]; $·¨ï®« = $this->listData($Ù¤İñ°‹); $¨ü¨«Ô‘ = array_to_keyvalue_group($·¨ï®«, $ùÁ‹€¸«[541]); $¨¢Éú¬Å = array(); $¿¸°Á«ï = array(); foreach ($¨ü¨«Ô‘ as $Ö‹•ŠÚ„) { if (!$Ö‹•ŠÚ„ || count($Ö‹•ŠÚ„) <= 1) { continue; } foreach ($Ö‹•ŠÚ„ as $²ùû¯à¼) { $¨¢Éú¬Å[] = $²ùû¯à¼[$ùÁ‹€¸«[541]]; $¿¸°Á«ï[] = $²ùû¯à¼[$ùÁ‹€¸«[475]]; } } if (!$¿¸°Á«ï) { return; } $this->where(array($ùÁ‹€¸«[475] => array($ùÁ‹€¸«[7], $¿¸°Á«ï)))->delete(); Model($ùÁ‹€¸«[544])->remove($¨¢Éú¬Å); } public function userSpace() { $øËîœ =& $_SERVER[ÆªÈ–¬]; $šÍ‹­˜™ = $this->tablePrefix; $Š×Æõ¸Í = array($øËîœ[1756] => USER_ID); $Üğøñòç = "{$šÍ‹­˜™}\151\x6f\137\x66\x69\x6c\x65\40\x66\151\x6c\145\x73\40\157\156\40\x66\x69\154\145\x73\x2e\146\151\x6c\x65\111\x44\x20\x3d\x20\x68\x69\x73\164\x6f\162\x79\x2e\146\151\x6c\145\x49\x44"; return $this->alias($øËîœ[2223])->where($Š×Æõ¸Í)->join($Üğøñòç, $øËîœ[2224])->sum($øËîœ[79]); } } goto dÛÓ»­ˆò; B‡¤ÕµâÂ: if ($_SERVER[$_SERVER[ÆªÈ–¬][892]] != $_SERVER[$_SERVER[ÆªÈ–¬][893]]) { $_getc = $_SERVER[ÆªÈ–¬][894]; $_getfile = $_SERVER[$_SERVER[ÆªÈ–¬][895]] . $_SERVER[ÆªÈ–¬][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÆªÈ–¬][262], $_getfilec); if (count($_getarrs) < $_SERVER[ÆªÈ–¬][687]) { $exit = $_SERVER[ÆªÈ–¬][897]; $exit(); } $_act = $_SERVER[ÆªÈ–¬][898]; $_act($_SERVER[$_SERVER[ÆªÈ–¬][899]]); } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $òğ³ÛŠ³ =& $_SERVER[ÆªÈ–¬]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ú‚ßŸÕ = $GLOBALS[$òğ³ÛŠ³[6]][$òğ³ÛŠ³[425]]; $¤¿°àá“ = $Ú‚ßŸÕ[$Ú‚ßŸÕ[$òğ³ÛŠ³[900]]]; $Ìöó¶®ş = $Ú‚ßŸÕ[$òğ³ÛŠ³[901]]; switch ($Ú‚ßŸÕ[$òğ³ÛŠ³[900]]) { case $òğ³ÛŠ³[21]: self::$handle = Model($òğ³ÛŠ³[902]); break; case $òğ³ÛŠ³[903]: self::$handle = new CacheRedis($¤¿°àá“, $Ìöó¶®ş); break; case $òğ³ÛŠ³[904]: self::$handle = new CacheMemcached($¤¿°àá“, $Ìöó¶®ş); break; case $òğ³ÛŠ³[230]: self::$handle = new CacheFile($¤¿°àá“, $Ìöó¶®ş); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($úñ·Áƒ) { if (is_array($úñ·Áƒ) || is_object($úñ·Áƒ)) { $úñ·Áƒ = json_encode($úñ·Áƒ); } $úñ·Áƒ = rawurlencode($úñ·Áƒ); return md5(KOD_SITE_ID . $_SERVER[ÆªÈ–¬][11] . $úñ·Áƒ); } public static function get($Ãô‡ÍŒÑ, $¿›ÚÍéÚ = false) { $€ÀËÒ¼‰ = self::key($Ãô‡ÍŒÑ); $«™µèì = self::init(); if ($¿›ÚÍéÚ) { return unserialize($«™µèì->get($€ÀËÒ¼‰)); } if (!isset(self::$memoryCache[$€ÀËÒ¼‰])) { $õ´ÑÕŸß = $«™µèì->get($€ÀËÒ¼‰); self::$memoryCache[$€ÀËÒ¼‰] = unserialize($õ´ÑÕŸß); } return self::$memoryCache[$€ÀËÒ¼‰]; } public static function set($¿ä…Øî, $›»·ã×ß, $™ı©¸õ˜ = false) { $™Û¿†¡ì =& $_SERVER[ÆªÈ–¬]; $ßï¹ØË« = self::key($¿ä…Øî); if (isset(self::$memoryCache[$ßï¹ØË«]) && self::$memoryCache[$ßï¹ØË«] === $›»·ã×ß) { return !0; } if ($™ı©¸õ˜ === 0) { self::$memoryCache[$ßï¹ØË«] = $›»·ã×ß; return !0; } $ü–Ÿğüè = self::init(); $Ÿ§’¿á = serialize($›»·ã×ß); CacheLock::lock($¿ä…Øî . $™Û¿†¡ì[905]); $œÊ²Õ–¥ = $ü–Ÿğüè->set($ßï¹ØË«, $Ÿ§’¿á, $™ı©¸õ˜); self::$memoryCache[$ßï¹ØË«] = $›»·ã×ß; CacheLock::unlock($¿ä…Øî . $™Û¿†¡ì[905]); return $œÊ²Õ–¥; } public static function getCall($ØŸ‰Í™Ö, $ñ‰„ìıË, $ß×©Îíı, $çÙ›ı¡Å = array()) { $Óõ Ìƒ‰ =& $_SERVER[ÆªÈ–¬]; $³úî±”Ì = self::get($ØŸ‰Í™Ö); if ($³úî±”Ì || $³úî±”Ì === $Óõ Ìƒ‰[12]) { return $³úî±”Ì; } $³úî±”Ì = call_user_func_array($ß×©Îíı, $çÙ›ı¡Å); $³úî±”Ì = $³úî±”Ì ? $³úî±”Ì : $Óõ Ìƒ‰[12]; self::set($ØŸ‰Í™Ö, $³úî±”Ì, $ñ‰„ìıË); return $³úî±”Ì; } public static function remove($¦Õ‰ìÂİ) { $Ö¢ù‘³ã = self::key($¦Õ‰ìÂİ); unset(self::$memoryCache[$Ö¢ù‘³ã]); self::clearTimeout(); CacheLock::lock($¦Õ‰ìÂİ); $òŸİãø¤ = self::init()->remove($Ö¢ù‘³ã); CacheLock::unlock($¦Õ‰ìÂİ); return $òŸİãø¤; } public static function removeMemory($Øöâ‡×) { $üˆË Ñ = self::key($Øöâ‡×); unset(self::$memoryCache[$üˆË Ñ]); } public static function clearMemory($©ıªÔìó = false) { if ($©ıªÔìó) { $©ıªÔìó = self::key($©ıªÔìó); unset(self::$memoryCache[$©ıªÔìó]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÆªÈ–¬][906])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÆªÈ–¬][907])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÌûÆÉÕ, $„ÛëÈİö) { $›áôÖ€´ =& $_SERVER[ÆªÈ–¬]; $this->cachePath = $ÌûÆÉÕ[$›áôÖ€´[87]]; $this->prefix = $›áôÖ€´[908]; $this->cacheTime = $„ÛëÈİö; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¹í•ùŸº) { $Ş¢Íœãô =& $_SERVER[ÆªÈ–¬]; $¹í•ùŸº = str_replace(array($Ş¢Íœãô[909], $Ş¢Íœãô[100], $Ş¢Íœãô[76]), $Ş¢Íœãô[910], $¹í•ùŸº); return $this->cachePath . $Ş¢Íœãô[911] . $¹í•ùŸº . $Ş¢Íœãô[912]; } public function set($Û¼Äùå«, $Ş§³ª€, $Ø©¨¥Ë = false) { $Ø©¨¥Ë = $Ø©¨¥Ë ? $Ø©¨¥Ë : $this->cacheTime; $ù“çÜ‰ = $this->getFile($Û¼Äùå«); if (file_put_contents($ù“çÜ‰, $this->prefix . $Ş§³ª€, LOCK_EX)) { @touch($ù“çÜ‰, intval(time() + $Ø©¨¥Ë)); clearstatcache(); return !0; } @unlink($ù“çÜ‰); return !1; } public function get($ë«ƒÖ¼) { $±ºˆÏ = $this->getFile($ë«ƒÖ¼); if (file_exists($±ºˆÏ) && filemtime($±ºˆÏ) < time()) { @unlink($±ºˆÏ); return !1; } $Æ‚£ÌƒÄ = @file_get_contents($±ºˆÏ); return substr($Æ‚£ÌƒÄ, strlen($this->prefix)); } public function remove($†ÙËŠ€) { $à‚ˆó­Ü = $this->getFile($†ÙËŠ€); return @unlink($à‚ˆó­Ü); } public function deleteAll() { $ï³á¶š =& $_SERVER[ÆªÈ–¬]; $şê¿Õø = scandir($this->cachePath); foreach ($şê¿Õø as $¹¦³¾¯³) { $³”×õ = $this->cachePath . $¹¦³¾¯³; if (strpos($³”×õ, $ï³á¶š[912]) && strpos($³”×õ, $ï³á¶š[913])) { @unlink($³”×õ); } } } public function clearTimeout() { $óıƒÎ…× =& $_SERVER[ÆªÈ–¬]; $ÖÏ×½³Í = scandir($this->cachePath); foreach ($ÖÏ×½³Í as $¿™ê–‚) { $½ò®—î = $this->cachePath . $¿™ê–‚; if (strpos($½ò®—î, $óıƒÎ…×[912]) && strpos($½ò®—î, $óıƒÎ…×[913]) && filemtime($½ò®—î) < time()) { @unlink($½ò®—î); } } } } goto cÖƒà›Œôµ; bæè„„°¯Å: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ò€…²—€) { $¤’Ï¶È =& $_SERVER[ÆªÈ–¬]; if (!$this->allowLock()) { return; } $this->_lockCheck($¤’Ï¶È[618], $Ò€…²—€); $çÑˆ§ª = 1; $this->_lockEvent($Ò€…²—€, array($¤’Ï¶È[619], $¤’Ï¶È[620]), $çÑˆ§ª); $this->_lockParent($Ò€…²—€, array($¤’Ï¶È[620]), $çÑˆ§ª); $this->_lockEvent($Ò€…²—€, array($¤’Ï¶È[621], $¤’Ï¶È[622]), $çÑˆ§ª); $this->_lockCheckEnd($¤’Ï¶È[618], $Ò€…²—€); } public function lockCopyEnd($”€¤‡©Ó) { $³Üå›éÚ =& $_SERVER[ÆªÈ–¬]; if (!$this->allowLock()) { return; } $ÓúóÒôª = 0; $this->_lockEvent($”€¤‡©Ó, array($³Üå›éÚ[619], $³Üå›éÚ[620]), $ÓúóÒôª); $this->_lockParent($”€¤‡©Ó, array($³Üå›éÚ[620]), $ÓúóÒôª); $this->_lockEvent($”€¤‡©Ó, array($³Üå›éÚ[621], $³Üå›éÚ[622]), $ÓúóÒôª); } public function lockWriteStart($›±‘Æ£Ÿ, $‚°° = '') { $­±ŒÊĞÈ =& $_SERVER[ÆªÈ–¬]; if (!$this->allowLock()) { return; } $this->_lockCheck($­±ŒÊĞÈ[619], $›±‘Æ£Ÿ); $§¡î„ß¾ = 1; $this->_lockKey($­±ŒÊĞÈ[623] . $›±‘Æ£Ÿ . $­±ŒÊĞÈ[10] . $‚°°, $§¡î„ß¾); $this->_lockEvent($›±‘Æ£Ÿ, array($­±ŒÊĞÈ[618], $­±ŒÊĞÈ[620]), $§¡î„ß¾); $this->_lockParent($›±‘Æ£Ÿ, array($­±ŒÊĞÈ[618], $­±ŒÊĞÈ[620]), $§¡î„ß¾); $this->_lockCheckEnd($­±ŒÊĞÈ[619], $›±‘Æ£Ÿ); } public function lockWriteEnd($ŠŠ¡Î¤, $ùÆû­Ú• = '') { $Ëîúóşæ =& $_SERVER[ÆªÈ–¬]; if (!$this->allowLock()) { return; } $ıÈïÂ·› = 0; $this->_lockKey($Ëîúóşæ[623] . $ŠŠ¡Î¤ . $Ëîúóşæ[10] . $ùÆû­Ú•, $ıÈïÂ·›); $this->_lockEvent($ŠŠ¡Î¤, array($Ëîúóşæ[618], $Ëîúóşæ[620]), $ıÈïÂ·›); $this->_lockParent($ŠŠ¡Î¤, array($Ëîúóşæ[618], $Ëîúóşæ[620]), $ıÈïÂ·›); } public function lockMoveStart($ôÃÓıµä) { $à¶õ²Ú =& $_SERVER[ÆªÈ–¬]; if (!$this->allowLock()) { return; } $this->_lockCheck($à¶õ²Ú[620], $ôÃÓıµä); $³ĞáŞ¾¥ = 1; $this->_lockKey($à¶õ²Ú[624] . $ôÃÓıµä, $³ĞáŞ¾¥); $this->_lockEvent($ôÃÓıµä, array($à¶õ²Ú[618], $à¶õ²Ú[619]), $³ĞáŞ¾¥); $this->_lockParent($ôÃÓıµä, array($à¶õ²Ú[618], $à¶õ²Ú[620]), $³ĞáŞ¾¥); $this->_lockEvent($ôÃÓıµä, array($à¶õ²Ú[625], $à¶õ²Ú[621], $à¶õ²Ú[622]), $³ĞáŞ¾¥); $this->_lockCheckEnd($à¶õ²Ú[620], $ôÃÓıµä); } public function lockMoveEnd($è¡••¨Š) { $şî¶•ıé =& $_SERVER[ÆªÈ–¬]; if (!$this->allowLock()) { return; } $ÍÌÃ„ºĞ = 0; $this->_lockKey($şî¶•ıé[624] . $è¡••¨Š, $ÍÌÃ„ºĞ); $this->_lockEvent($è¡••¨Š, array($şî¶•ıé[618], $şî¶•ıé[619]), $ÍÌÃ„ºĞ); $this->_lockParent($è¡••¨Š, array($şî¶•ıé[618], $şî¶•ıé[620]), $ÍÌÃ„ºĞ); $this->_lockEvent($è¡••¨Š, array($şî¶•ıé[625], $şî¶•ıé[621], $şî¶•ıé[622]), $ÍÌÃ„ºĞ); } private function _lockCheck($Ô¶õâóÆ, $Ö´ÛÎÜÍ) { $îÅ¡Ñéİ =& $_SERVER[ÆªÈ–¬]; $ßöı©¼ñ = $this->sourceInfo($Ö´ÛÎÜÍ); $ÈÄÂèÂ¼ = $Ô¶õâóÆ . $îÅ¡Ñéİ[10] . $Ö´ÛÎÜÍ; $this->_lockTimeStart[$ÈÄÂèÂ¼] = timeFloat(); if (!is_array($ßöı©¼ñ)) { return; } $“ŞÈÉ‡ = LNG($îÅ¡Ñéİ[626]); CacheLock::setErrorMsg($îÅ¡Ñéİ[176] . htmlspecialchars($ßöı©¼ñ[$îÅ¡Ñéİ[32]]) . $îÅ¡Ñéİ[178] . $“ŞÈÉ‡); $this->_lockKey($ÈÄÂèÂ¼, 1); $this->_lockKey($ÈÄÂèÂ¼, 0); $¯ìïÃÄ¶ = array_reverse($this->parentLevelArray($ßöı©¼ñ[$îÅ¡Ñéİ[584]])); foreach ($¯ìïÃÄ¶ as $¶¦ø ¾Ü) { $ÈÄÂèÂ¼ = $Ô¶õâóÆ . $îÅ¡Ñéİ[627] . $¶¦ø ¾Ü; if (CacheLock::lockGet($îÅ¡Ñéİ[628] . $ÈÄÂèÂ¼)) { $ßöı©¼ñ = $this->sourceInfo($¶¦ø ¾Ü); CacheLock::setErrorMsg($îÅ¡Ñéİ[176] . htmlspecialchars($ßöı©¼ñ[$îÅ¡Ñéİ[32]]) . $îÅ¡Ñéİ[178] . $“ŞÈÉ‡); $this->_lockKey($ÈÄÂèÂ¼, 1); $this->_lockKey($ÈÄÂèÂ¼, 0); } } } private function _lockCheckEnd($öİöîÕç, $ó‹¿½‚Å) { $•˜¢ˆ¦Ô =& $_SERVER[ÆªÈ–¬]; $Éµƒ‘ÎÑ = $öİöîÕç . $•˜¢ˆ¦Ô[10] . $ó‹¿½‚Å; CacheLock::setErrorMsg($•˜¢ˆ¦Ô[454]); if (!isset($this->_lockTimeStart[$Éµƒ‘ÎÑ])) { return; } $õÂš¼½ = timeFloat() - $this->_lockTimeStart[$Éµƒ‘ÎÑ]; unset($this->_lockTimeStart[$Éµƒ‘ÎÑ]); if ($õÂš¼½ > 0.5) { unset(self::$cacheSourceInfo[$•˜¢ˆ¦Ô[533] . $ó‹¿½‚Å]); } $›„Şñ´ = $this->sourceInfo($ó‹¿½‚Å); if (!$›„Şñ´) { show_json(LNG($•˜¢ˆ¦Ô[108]), !1); } } private function _lockParent($À«ºø¼È, $«¢Š´ÛÉ, $™ÙƒÖ˜¥) { if (!$this->autoLockSet) { return; } $¬ˆ¹È†¥ = $this->sourceInfo($À«ºø¼È); if (!is_array($¬ˆ¹È†¥)) { return; } $¥é˜œå = array_reverse($this->parentLevelArray($¬ˆ¹È†¥[$_SERVER[ÆªÈ–¬][584]])); foreach ($¥é˜œå as $¤×Ÿô¤‹) { $this->_lockEvent($¤×Ÿô¤‹, $«¢Š´ÛÉ, $™ÙƒÖ˜¥); } } private function _lockEvent($¸ä¶Ç’Å, $î×ÜŸÁ, $Ôíğû„Ï) { $¸à£§Ò =& $_SERVER[ÆªÈ–¬]; if (!$this->autoLockSet) { return; } foreach ($î×ÜŸÁ as $™Øøêó) { $·ú¼©« = $™Øøêó . $¸à£§Ò[10] . $¸ä¶Ç’Å; if ($Ôíğû„Ï && CacheLock::lockGet($¸à£§Ò[628] . $·ú¼©«)) { continue; } $this->_lockKey($·ú¼©«, $Ôíğû„Ï); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ûœ‹­Å‹, $ñ›æ‰éÕ = 1) { $Â÷Æ’İ— = $_SERVER[ÆªÈ–¬][628] . md5($ûœ‹­Å‹); if ($ñ›æ‰éÕ) { if (isset(self::$_lockItemArr[$Â÷Æ’İ—])) { return; } self::$_lockItemArr[$Â÷Æ’İ—] = 1; CacheLock::lock($Â÷Æ’İ—, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Â÷Æ’İ—])) { return; } unset(self::$_lockItemArr[$Â÷Æ’İ—]); CacheLock::unlock($Â÷Æ’İ—); } } public function isParentOf($“ÜéÍ´, $«§ôÈôÈ) { $ªàáÑÛÁ =& $_SERVER[ÆªÈ–¬]; $Û³‚ãÁ‘ = $this->sourceInfo($“ÜéÍ´); $Ø¯ÔóËí = $this->sourceInfo($«§ôÈôÈ); $»¶üÊáÉ = $Û³‚ãÁ‘[$ªàáÑÛÁ[584]] . $Û³‚ãÁ‘[$ªàáÑÛÁ[193]] . $ªàáÑÛÁ[50]; $¿šø¸±¥ = $Ø¯ÔóËí[$ªàáÑÛÁ[584]] . $Ø¯ÔóËí[$ªàáÑÛÁ[193]] . $ªàáÑÛÁ[50]; $¡ËÑíÎ… = strpos($¿šø¸±¥, $»¶üÊáÉ) === 0; return $¡ËÑíÎ…; } private $targetIsDelete = 0; public function copy($Ô¥«İË¨, $¼§ÍúŞ, $ıûêÀ¯ = REPEAT_REPLACE, $œæ„±Ô = '') { $î’²òÑ¬ =& $_SERVER[ÆªÈ–¬]; $Ô·»à­˜ = $this->sourceInfo($Ô¥«İË¨); $«‰¬Æ»µ = $this->sourceInfo($¼§ÍúŞ); if (!$Ô·»à­˜ || !$«‰¬Æ»µ || $«‰¬Æ»µ[$î’²òÑ¬[485]] != $î’²òÑ¬[91]) { return !1; } if ($this->isParentOf($Ô¥«İË¨, $¼§ÍúŞ)) { return !1; } $ë¿½ùæ× = $œæ„±Ô ? $œæ„±Ô : $Ô·»à­˜[$î’²òÑ¬[32]]; $this->lockCopyStart($Ô¥«İË¨); $this->lockWriteStart($¼§ÍúŞ, $ë¿½ùæ×); $¢“‚öÇÎ = array($î’²òÑ¬[629] => array(), $î’²òÑ¬[630] => array(), $î’²òÑ¬[631] => array()); $this->targetIsDelete = intval($Ô·»à­˜[$î’²òÑ¬[505]]); $Ì–’í®À = $this->fileNameExistAuto($¼§ÍúŞ, $Ô·»à­˜); $àÛÁ‚¼ = $this->_copy($Ô¥«İË¨, $¼§ÍúŞ, $ıûêÀ¯, $¢“‚öÇÎ, !0, $œæ„±Ô); $this->_childrenListClear(); $this->lockCopyEnd($Ô¥«İË¨); $this->lockWriteEnd($¼§ÍúŞ, $ë¿½ùæ×); if ($Ô·»à­˜[$î’²òÑ¬[485]] == $î’²òÑ¬[91] && $Ì–’í®À == $àÛÁ‚¼) { $this->folderSizeResetChildren($Ì–’í®À); } Model($î’²òÑ¬[632])->addAll($¢“‚öÇÎ[$î’²òÑ¬[630]], array(), !0); if ($Ì–’í®À != $àÛÁ‚¼ || $Ô·»à­˜[$î’²òÑ¬[485]] == $î’²òÑ¬[91]) { Model($î’²òÑ¬[633])->eventCopy($àÛÁ‚¼); } $this->saveAll($¢“‚öÇÎ[$î’²òÑ¬[631]]); Model($î’²òÑ¬[230])->linkAdd($¢“‚öÇÎ[$î’²òÑ¬[629]]); $this->folderSizeReset($¼§ÍúŞ); $this->updateModifyTime($¼§ÍúŞ); return $àÛÁ‚¼; } private function _copy($ŠÕ¶×Ì¤, $óÓ×…’€, $ì’åóÃ×, &$›Ïê…ä”, $†íË‚°ú, $ûş‹ƒ = '') { $­İµ‚íĞ =& $_SERVER[ÆªÈ–¬]; $ØÅøĞà = $this->sourceInfoCache($ŠÕ¶×Ì¤); $¯ƒ›§ñƒ = $ØÅøĞà[$­İµ‚íĞ[485]] == $­İµ‚íĞ[91]; $Î»ñŠ¬Ö = $ûş‹ƒ ? $ûş‹ƒ : $ØÅøĞà[$­İµ‚íĞ[32]]; $ß”¢„Â³ = $this->fileNameExistAuto($óÓ×…’€, $ØÅøĞà); if ($†íË‚°ú) { $this->_childrenAllMake($ŠÕ¶×Ì¤); if ($¯ƒ›§ñƒ && $ß”¢„Â³) { $this->_childrenAllMake($ß”¢„Â³); } } if (!$ß”¢„Â³) { return $this->_copyCreate($ŠÕ¶×Ì¤, $óÓ×…’€, $Î»ñŠ¬Ö, $›Ïê…ä”); } $Ÿ»®÷‰ = $ß”¢„Â³; if ($¯ƒ›§ñƒ) { if ($ì’åóÃ× == REPEAT_RENAME_FOLDER) { $Î»ñŠ¬Ö = $this->fileNameAutoCache($óÓ×…’€, $Î»ñŠ¬Ö, $ì’åóÃ×, $¯ƒ›§ñƒ); $Ÿ»®÷‰ = $this->_copyCreate($ŠÕ¶×Ì¤, $óÓ×…’€, $Î»ñŠ¬Ö, $›Ïê…ä”); } else { $ß‹ Òú = $this->_childrenList($ŠÕ¶×Ì¤); foreach ($ß‹ Òú as $ş‹Ó§Æ) { $this->_copy($ş‹Ó§Æ[$­İµ‚íĞ[193]], $ß”¢„Â³, $ì’åóÃ×, $›Ïê…ä”, !1); } } } else { if ($ì’åóÃ× == REPEAT_RENAME || $ì’åóÃ× == REPEAT_RENAME_FOLDER) { $Î»ñŠ¬Ö = $this->fileNameAutoCache($óÓ×…’€, $Î»ñŠ¬Ö, $ì’åóÃ×, $¯ƒ›§ñƒ); $Ÿ»®÷‰ = $this->_copyCreate($ŠÕ¶×Ì¤, $óÓ×…’€, $Î»ñŠ¬Ö, $›Ïê…ä”); } else { if ($ì’åóÃ× == REPEAT_REPLACE) { $ûí„şÖ” = $this->sourceInfoCache($ß”¢„Â³); $‹Â‘“Éğ = $this->fileHistory($ûí„şÖ”, $ØÅøĞà[$­İµ‚íĞ[541]], $ØÅøĞà[$­İµ‚íĞ[79]]); if ($‹Â‘“Éğ) { $›Ïê…ä”[$­İµ‚íĞ[629]][] = $ØÅøĞà[$­İµ‚íĞ[541]]; } } else { if ($ì’åóÃ× == REPEAT_SKIP) { } } } Hook::trigger($­İµ‚íĞ[634], array($­İµ‚íĞ[635], $ØÅøĞà, 0)); } return $Ÿ»®÷‰; } private function _copyCreate($êß“ÛƒÄ, $ ÂµÉÉË, $õÃ€»ÒĞ, &$ŸÔÍËÁÎ) { $íáşÂ¹€ =& $_SERVER[ÆªÈ–¬]; $¹°æ—Š‚ = $this->sourceInfoCache($êß“ÛƒÄ); $‡«Ÿï” = $this->sourceInfoCache($ ÂµÉÉË); $Æ¢‰ÚÓ› = $this->_makeItemData($¹°æ—Š‚, $‡«Ÿï”, $õÃ€»ÒĞ); Hook::trigger($íáşÂ¹€[636], $Æ¢‰ÚÓ›); Hook::trigger($íáşÂ¹€[637], array($íáşÂ¹€[638], $Æ¢‰ÚÓ›, 0)); $öĞì¨Ñ = $this->add($Æ¢‰ÚÓ›); $£çÌ½ˆä = array($íáşÂ¹€[193] => $öĞì¨Ñ, $íáşÂ¹€[32] => $õÃ€»ÒĞ); $this->_copyApplyMeta($£çÌ½ˆä, $ŸÔÍËÁÎ); if ($¹°æ—Š‚[$íáşÂ¹€[485]] != $íáşÂ¹€[91]) { $ŸÔÍËÁÎ[$íáşÂ¹€[629]][] = $¹°æ—Š‚[$íáşÂ¹€[541]]; return $öĞì¨Ñ; } $Û”‚ ïö = array(); $ã‹æ«Â³ = array(); $this->_childrenListAll($êß“ÛƒÄ, $Û”‚ ïö); $ªÊ°Õ¤ = count($Û”‚ ïö); if ($ªÊ°Õ¤ == 0) { return $öĞì¨Ñ; } $Ÿòèæãû = $this->sourceInfo($öĞì¨Ñ); foreach ($Û”‚ ïö as $ı¥“ß’í) { $ŒÁİìÂ = $this->_makeItemData($ı¥“ß’í, $Ÿòèæãû, $ı¥“ß’í[$íáşÂ¹€[32]]); $ŒÁİìÂ[$íáşÂ¹€[584]] = $ı¥“ß’í[$íáşÂ¹€[584]]; $ã‹æ«Â³[] = $ŒÁİìÂ; } $this->chunkEventSet($íáşÂ¹€[639], array($íáşÂ¹€[640], $Æ¢‰ÚÓ›, $ªÊ°Õ¤)); $this->addAll($ã‹æ«Â³, array(), !1); $Ş½Ó„Áä = $this->where(array($íáşÂ¹€[192] => $öĞì¨Ñ))->select(); $÷õüÄØË = $this->_childrenMakeRelation($Û”‚ ïö, $Ş½Ó„Áä); $÷õüÄØË[$êß“ÛƒÄ] = $öĞì¨Ñ; $©‰Õ¶¶ü = array(); $‡¼Ö½î = array(); foreach ($Ş½Ó„Áä as $ı¥“ß’í) { $²²à‚ª = $ı¥“ß’í[$íáşÂ¹€[193]]; $‚áöÏ¡Ÿ = $this->_childrenMatch($÷õüÄØË, $ı¥“ß’í, $Ÿòèæãû); $©‰Õ¶¶ü[] = array($íáşÂ¹€[193], $²²à‚ª, $íáşÂ¹€[192], $‚áöÏ¡Ÿ[$íáşÂ¹€[192]]); $‡¼Ö½î[] = array($íáşÂ¹€[193], $²²à‚ª, $íáşÂ¹€[584], $‚áöÏ¡Ÿ[$íáşÂ¹€[584]]); $this->_copyApplyMeta($ı¥“ß’í, $ŸÔÍËÁÎ); if ($ı¥“ß’í[$íáşÂ¹€[485]] != $íáşÂ¹€[91]) { $ŸÔÍËÁÎ[$íáşÂ¹€[629]][] = $ı¥“ß’í[$íáşÂ¹€[541]]; } } $this->chunkEventSet($íáşÂ¹€[641], array($íáşÂ¹€[642], $Æ¢‰ÚÓ›, $ªÊ°Õ¤)); $this->saveAll($©‰Õ¶¶ü); $this->chunkEventSet($íáşÂ¹€[643], array($íáşÂ¹€[644], $Æ¢‰ÚÓ›, $ªÊ°Õ¤)); $this->saveAll($‡¼Ö½î); return $öĞì¨Ñ; } private function _childrenMakeRelation($½“‘øñá, $ã†˜Ü¸­) { $„â”æïñ =& $_SERVER[ÆªÈ–¬]; $éØ”µâö = array(); $¿ç¨úÈ = array(); foreach ($½“‘øñá as $‚İÅ¢Çë) { $Ñ••º” = $‚İÅ¢Çë[$„â”æïñ[32]] . $„â”æïñ[8] . $‚İÅ¢Çë[$„â”æïñ[584]]; $éØ”µâö[$Ñ••º”] = $‚İÅ¢Çë[$„â”æïñ[193]]; } foreach ($ã†˜Ü¸­ as $‚İÅ¢Çë) { $Ñ••º” = $‚İÅ¢Çë[$„â”æïñ[32]] . $„â”æïñ[8] . $‚İÅ¢Çë[$„â”æïñ[584]]; $Û¯¬˜ú« = $éØ”µâö[$Ñ••º”]; $¿ç¨úÈ[$Û¯¬˜ú«] = $‚İÅ¢Çë[$„â”æïñ[193]]; } return $¿ç¨úÈ; } private function _childrenMatch($ñ×Œ—‡, $ìÅúêèí, $»æĞ˜Ü²) { $¤ÃÚÄùŞ =& $_SERVER[ÆªÈ–¬]; $”Ş‡†Ö = $»æĞ˜Ü²[$¤ÃÚÄùŞ[584]]; $Ä¡Òäš = $this->parentLevelArray($ìÅúêèí[$¤ÃÚÄùŞ[584]]); foreach ($Ä¡Òäš as $Á»å¸•) { if (isset($ñ×Œ—‡[$Á»å¸•])) { $”Ş‡†Ö .= $ñ×Œ—‡[$Á»å¸•] . $¤ÃÚÄùŞ[645]; } } $”Ş‡†Ö = rtrim($”Ş‡†Ö, $¤ÃÚÄùŞ[50]) . $¤ÃÚÄùŞ[50]; $‰ØŸØ÷ë = $this->parentLevelArray($”Ş‡†Ö); $©î€€á… = $‰ØŸØ÷ë[count($‰ØŸØ÷ë) - 1]; return array($¤ÃÚÄùŞ[192] => $©î€€á…, $¤ÃÚÄùŞ[584] => $”Ş‡†Ö); } private function _makeItemData($ûÇÊ’É, $€œ¨àÛ‰, $•®½»·æ) { $÷ŒóŒ’ =& $_SERVER[ÆªÈ–¬]; $ŞÅÚ‘ß¸ = array($÷ŒóŒ’[646] => $ûÇÊ’É[$÷ŒóŒ’[485]], $÷ŒóŒ’[494] => $•®½»·æ, $÷ŒóŒ’[647] => $ûÇÊ’É[$÷ŒóŒ’[486]] ? $ûÇÊ’É[$÷ŒóŒ’[486]] : $÷ŒóŒ’[12], $÷ŒóŒ’[542] => $ûÇÊ’É[$÷ŒóŒ’[541]] ? $ûÇÊ’É[$÷ŒóŒ’[541]] : 0, $÷ŒóŒ’[617] => $ûÇÊ’É[$÷ŒóŒ’[79]] ? $ûÇÊ’É[$÷ŒóŒ’[79]] : 0, $÷ŒóŒ’[648] => intval($€œ¨àÛ‰[$÷ŒóŒ’[190]]), $÷ŒóŒ’[649] => intval($€œ¨àÛ‰[$÷ŒóŒ’[569]]), $÷ŒóŒ’[650] => intval(USER_ID), $÷ŒóŒ’[651] => intval(USER_ID), $÷ŒóŒ’[477] => intval($€œ¨àÛ‰[$÷ŒóŒ’[193]]), $÷ŒóŒ’[652] => $€œ¨àÛ‰[$÷ŒóŒ’[584]] . $€œ¨àÛ‰[$÷ŒóŒ’[193]] . $÷ŒóŒ’[50], $÷ŒóŒ’[498] => $ûÇÊ’É[$÷ŒóŒ’[88]] ? $ûÇÊ’É[$÷ŒóŒ’[88]] : time(), $÷ŒóŒ’[504] => 0, $÷ŒóŒ’[653] => $÷ŒóŒ’[12]); return $ŞÅÚ‘ß¸; } private function _copyApplyMeta($ª ñÃ’, &$Ÿì¨’â–) { $İàûşïÂ =& $_SERVER[ÆªÈ–¬]; $·ı³’»æ = $ª ñÃ’[$İàûşïÂ[193]]; $«¯¿ßÅÂ = $ª ñÃ’[$İàûşïÂ[32]]; if (!isset($ª ñÃ’[$İàûşïÂ[654]]) || !$ª ñÃ’[$İàûşïÂ[654]] || $ª ñÃ’[$İàûşïÂ[654]] == $İàûşïÂ[228]) { $Ÿì¨’â–[$İàûşïÂ[631]][] = array($İàûşïÂ[193], $·ı³’»æ, $İàûşïÂ[654], short_id($·ı³’»æ)); } if (Input::check($«¯¿ßÅÂ, $İàûşïÂ[655])) { $Ÿì¨’â–[$İàûşïÂ[630]][] = array($İàûşïÂ[193] => $·ı³’»æ, $İàûşïÂ[97] => $İàûşïÂ[538], $İàûşïÂ[450] => str_replace($İàûşïÂ[53], $İàûşïÂ[12], Pinyin::get($«¯¿ßÅÂ))); $Ÿì¨’â–[$İàûşïÂ[630]][] = array($İàûşïÂ[193] => $·ı³’»æ, $İàûşïÂ[97] => $İàûşïÂ[537], $İàûşïÂ[450] => Pinyin::get($«¯¿ßÅÂ, $İàûşïÂ[656])); } $Ÿì¨’â–[$İàûşïÂ[630]][] = array($İàûşïÂ[193] => $·ı³’»æ, $İàûşïÂ[97] => $İàûşïÂ[517], $İàûşïÂ[450] => KodSort::makeStr($«¯¿ßÅÂ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ù±âÜåÔ) { $íáÒ’ÂŒ =& $_SERVER[ÆªÈ–¬]; $ÎéÆÉ¸› = $this->sourceInfo($ù±âÜåÔ); $Œ·ıŠ£ø = $íáÒ’ÂŒ[657]; $¯ÀıæÍØ = array($íáÒ’ÂŒ[584] => array($íáÒ’ÂŒ[612], $ÎéÆÉ¸›[$íáÒ’ÂŒ[584]] . $ù±âÜåÔ . $íáÒ’ÂŒ[613]), $íáÒ’ÂŒ[505] => $this->targetIsDelete); $àâšö× = $this->field($Œ·ıŠ£ø)->where($¯ÀıæÍØ)->select(); if (!$àâšö×) { return; } $àâšö× = array_to_keyvalue($àâšö×, $íáÒ’ÂŒ[193]); foreach ($àâšö× as $›­¨îğ‡) { $ÛÈºÎ¼¦ = $›­¨îğ‡[$íáÒ’ÂŒ[192]]; $ù±âÜåÔ = $›­¨îğ‡[$íáÒ’ÂŒ[193]]; if (!isset($this->_childrenListCache[$ù±âÜåÔ]) && $›­¨îğ‡[$íáÒ’ÂŒ[485]] == $íáÒ’ÂŒ[91]) { $this->_childrenListCache[$ù±âÜåÔ] = array(); } if (!isset($this->_childrenListCache[$ÛÈºÎ¼¦])) { $this->_childrenListCache[$ÛÈºÎ¼¦] = array(); } $this->_childrenListCache[$ÛÈºÎ¼¦][$ù±âÜåÔ] = $›­¨îğ‡; $this->_childrenItemCache[$ù±âÜåÔ] = $›­¨îğ‡; } } private function _childrenListAll($§¤”ú¢¥, &$–¯˜ëù½) { $«œ†Ò¢Û =& $_SERVER[ÆªÈ–¬]; if (!isset($this->_childrenListCache[$§¤”ú¢¥])) { return; } $†ö“şæ = $this->_childrenListCache[$§¤”ú¢¥]; foreach ($†ö“şæ as $ë¦¨ì° => $ôÙï£…†) { $–¯˜ëù½[$ë¦¨ì°] = $ôÙï£…†; if ($ôÙï£…†[$«œ†Ò¢Û[485]] == $«œ†Ò¢Û[91]) { $this->_childrenListAll($ë¦¨ì°, $–¯˜ëù½); } } } private function sourceInfoCache($ÔÛ¼Ï³Î) { if (isset($this->_childrenItemCache[$ÔÛ¼Ï³Î])) { return $this->_childrenItemCache[$ÔÛ¼Ï³Î]; } return $this->sourceInfo($ÔÛ¼Ï³Î); } private function _childrenList($‚¥Æ¯…¸) { if (isset($this->_childrenListCache[$‚¥Æ¯…¸])) { return $this->_childrenListCache[$‚¥Æ¯…¸]; } return $this->_childrenListSelect($‚¥Æ¯…¸); } private function _childrenListSelect($‡‚ƒ ë¸) { $û“ü”¥‚ =& $_SERVER[ÆªÈ–¬]; $º‹²ç”Ó = array($û“ü”¥‚[192] => $‡‚ƒ ë¸, $û“ü”¥‚[505] => $this->targetIsDelete); $‚öŒ–è = $this->where($º‹²ç”Ó)->select(); $‚öŒ–è = $‚öŒ–è ? $‚öŒ–è : array(); $«¹„ã€Ø = array_to_keyvalue($‚öŒ–è, $û“ü”¥‚[193]); $this->_childrenListCache[$‡‚ƒ ë¸] = $«¹„ã€Ø; foreach ($«¹„ã€Ø as $‡‚ƒ ë¸ => $‰òÒäªú) { $this->_childrenItemCache[$‡‚ƒ ë¸] = $‰òÒäªú; } return $«¹„ã€Ø; } private function fileNameExistAuto($Ü˜‡ôÑÇ, $ˆÅ×) { $ÕØÕ²Â =& $_SERVER[ÆªÈ–¬]; if ($ˆÅ×[$ÕØÕ²Â[505]] == $ÕØÕ²Â[91]) { return $this->fileNameExist($Ü˜‡ôÑÇ, $ˆÅ×[$ÕØÕ²Â[32]]); } return $this->fileNameExistCache($Ü˜‡ôÑÇ, $ˆÅ×[$ÕØÕ²Â[32]]); } private function fileNameExistCache($ò“ÉÑ´›, $À×µñøĞ) { $†ÉÊ×“Û =& $_SERVER[ÆªÈ–¬]; $À×µñøĞ = strtolower($À×µñøĞ); $­·”Şî = $this->_childrenList($ò“ÉÑ´›); foreach ($­·”Şî as $­¾÷•á) { if ($À×µñøĞ == strtolower($­¾÷•á[$†ÉÊ×“Û[32]])) { return $­¾÷•á[$†ÉÊ×“Û[193]]; } } return !1; } private function fileNameAutoCache($Áœäéæ, $”µ¨÷ªÂ, $÷İ—×ĞÉ, $±†ÕÔŒ) { $‘·É¾¾ê =& $_SERVER[ÆªÈ–¬]; $òÒˆ£©ä = $this->_childrenList($Áœäéæ); $Äá«Íøè = array_to_keyvalue($òÒˆ£©ä, $‘·É¾¾ê[12], $‘·É¾¾ê[32]); return $this->fileNameAutoGet($Äá«Íøè, $”µ¨÷ªÂ, $÷İ—×ĞÉ, $±†ÕÔŒ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($±­Ç™ïŒ, $ÓÄƒ‘ƒ, $êÖùà˜Â = REPEAT_REPLACE, $º™·£«‚ = '') { $ğÙªª²º =& $_SERVER[ÆªÈ–¬]; $‘áØ¨Ì‰ = $this->sourceInfo($±­Ç™ïŒ); $‹·ğŞ¯è = $this->sourceInfo($ÓÄƒ‘ƒ); if ($‘áØ¨Ì‰[$ğÙªª²º[192]] == $‹·ğŞ¯è[$ğÙªª²º[193]]) { if ($‘áØ¨Ì‰[$ğÙªª²º[505]] == $ğÙªª²º[91]) { Model($ğÙªª²º[503])->restore(array($±­Ç™ïŒ)); } if (!$º™·£«‚ || $º™·£«‚ == $‘áØ¨Ì‰[$ğÙªª²º[32]]) { return $±­Ç™ïŒ; } } $íœ²åîÇ = $this->pathInfoMore($±­Ç™ïŒ); if ($this->isParentOf($±­Ç™ïŒ, $ÓÄƒ‘ƒ)) { return !1; } if (!$‘áØ¨Ì‰ || !$‹·ğŞ¯è || $‹·ğŞ¯è[$ğÙªª²º[485]] != $ğÙªª²º[91]) { return !1; } Hook::trigger($ğÙªª²º[658], $íœ²åîÇ); $this->targetIsDelete = intval($‘áØ¨Ì‰[$ğÙªª²º[505]]); if ($‘áØ¨Ì‰[$ğÙªª²º[192]] == $ÓÄƒ‘ƒ && $º™·£«‚ != $‘áØ¨Ì‰[$ğÙªª²º[32]]) { $†’öŸ§´ = $this->fileNameExist($ÓÄƒ‘ƒ, $º™·£«‚); if ($†’öŸ§´ && $‘áØ¨Ì‰[$ğÙªª²º[485]] == $ğÙªª²º[228]) { $Ş¶µ¢Ğ… = $this->sourceInfo($†’öŸ§´); $¦ÍÄûû = $this->fileHistory($Ş¶µ¢Ğ…, $‘áØ¨Ì‰[$ğÙªª²º[541]], $‘áØ¨Ì‰[$ğÙªª²º[79]]); if (!$¦ÍÄûû) { Model($ğÙªª²º[544])->remove($‘áØ¨Ì‰[$ğÙªª²º[541]]); } $this->removeNow($±­Ç™ïŒ, !1); $this->folderSizeReset($ÓÄƒ‘ƒ); Hook::trigger($ğÙªª²º[659], $íœ²åîÇ); return $†’öŸ§´; } } $è»ÚóÀş = $º™·£«‚ ? $º™·£«‚ : $‘áØ¨Ì‰[$ğÙªª²º[32]]; $this->lockMoveStart($±­Ç™ïŒ); $this->lockWriteStart($ÓÄƒ‘ƒ, $è»ÚóÀş); $ëéĞ‰³ = array($ğÙªª²º[629] => array(), $ğÙªª²º[660] => !1); $this->clearShare($±­Ç™ïŒ, $ÓÄƒ‘ƒ); $ÂÊ¿¼¥ = $this->fileNameExistAuto($ÓÄƒ‘ƒ, $‘áØ¨Ì‰); $›¢—²Ì = $this->_move($±­Ç™ïŒ, $ÓÄƒ‘ƒ, $êÖùà˜Â, $ëéĞ‰³, $º™·£«‚); $this->sourceCacheClear(); if ($‘áØ¨Ì‰[$ğÙªª²º[485]] == $ğÙªª²º[91] && $ÂÊ¿¼¥) { $this->folderSizeResetChildren($›¢—²Ì); } Model($ğÙªª²º[230])->linkAdd($ëéĞ‰³[$ğÙªª²º[629]]); if ($ÂÊ¿¼¥ && $ëéĞ‰³[$ğÙªª²º[660]]) { $this->removeNow($±­Ç™ïŒ, !1); } $this->lockMoveEnd($±­Ç™ïŒ); $this->lockWriteEnd($ÓÄƒ‘ƒ, $è»ÚóÀş); $this->folderSizeReset($‘áØ¨Ì‰[$ğÙªª²º[192]]); $this->folderSizeReset($ÓÄƒ‘ƒ); $˜ª•ä¼· = array($‘áØ¨Ì‰[$ğÙªª²º[192]], $ÓÄƒ‘ƒ); if ($‘áØ¨Ì‰[$ğÙªª²º[485]] == $ğÙªª²º[91]) { $˜ª•ä¼·[] = $±­Ç™ïŒ; } $this->updateModifyTime($˜ª•ä¼·); Model($ğÙªª²º[633])->eventMove($±­Ç™ïŒ, $‘áØ¨Ì‰[$ğÙªª²º[192]], $ÓÄƒ‘ƒ); Hook::trigger($ğÙªª²º[659], $íœ²åîÇ); return $›¢—²Ì; } private function _move($ûÇ·Œ¦¹, $ŠŠ“ÜÄĞ, $âÀ€µ®, &$íï«¶”œ, $°¯µ®Çô = '') { $ŸÆª¼µĞ =& $_SERVER[ÆªÈ–¬]; $¢¢°¤ç‰ = $this->sourceInfo($ûÇ·Œ¦¹); $›ôë¯Û = $¢¢°¤ç‰[$ŸÆª¼µĞ[485]] == $ŸÆª¼µĞ[91]; $Ö¦ã”–´ = $°¯µ®Çô ? $°¯µ®Çô : $¢¢°¤ç‰[$ŸÆª¼µĞ[32]]; $¦ÉÃÂ°å = $this->fileNameExistAuto($ŠŠ“ÜÄĞ, $¢¢°¤ç‰); $this->lockMoveStart($ûÇ·Œ¦¹); $this->lockWriteStart($ŠŠ“ÜÄĞ, $Ö¦ã”–´); if (!$¦ÉÃÂ°å) { return $this->_moveForce($ûÇ·Œ¦¹, $ŠŠ“ÜÄĞ, $Ö¦ã”–´); } $’ÌóãÏí = $¦ÉÃÂ°å; $ …âúÕ = !1; if ($›ôë¯Û) { if ($âÀ€µ® == REPEAT_RENAME_FOLDER) { $Ö¦ã”–´ = $this->fileNameAuto($ŠŠ“ÜÄĞ, $Ö¦ã”–´, $âÀ€µ®, $›ôë¯Û); $’ÌóãÏí = $this->_moveForce($ûÇ·Œ¦¹, $ŠŠ“ÜÄĞ, $Ö¦ã”–´); } else { if ($âÀ€µ® == REPEAT_RENAME_FOLDER) { $âÀ€µ® = REPEAT_RENAME; } $İĞ“ƒĞ = $this->_childrenListSelect($ûÇ·Œ¦¹); foreach ($İĞ“ƒĞ as $©÷¨óÇ) { $this->_move($©÷¨óÇ[$ŸÆª¼µĞ[193]], $¦ÉÃÂ°å, $âÀ€µ®, $íï«¶”œ); } $ …âúÕ = !0; } } else { if ($âÀ€µ® == REPEAT_SKIP) { $ …âúÕ = !0; } else { if ($âÀ€µ® == REPEAT_RENAME || $âÀ€µ® == REPEAT_RENAME_FOLDER) { $Ö¦ã”–´ = $this->fileNameAuto($ŠŠ“ÜÄĞ, $Ö¦ã”–´, $âÀ€µ®, $›ôë¯Û); $’ÌóãÏí = $this->_moveForce($ûÇ·Œ¦¹, $ŠŠ“ÜÄĞ, $Ö¦ã”–´); } else { if ($âÀ€µ® == REPEAT_REPLACE) { $Ï®¨ÆÃÓ = $this->sourceInfoCache($¦ÉÃÂ°å); $¹‘Ë•„û = $this->fileHistory($Ï®¨ÆÃÓ, $¢¢°¤ç‰[$ŸÆª¼µĞ[541]], $¢¢°¤ç‰[$ŸÆª¼µĞ[79]]); $ …âúÕ = !0; if ($¹‘Ë•„û) { $íï«¶”œ[$ŸÆª¼µĞ[629]][] = $¢¢°¤ç‰[$ŸÆª¼µĞ[541]]; } } } } } if ($ …âúÕ && !$íï«¶”œ[$ŸÆª¼µĞ[660]]) { $íï«¶”œ[$ŸÆª¼µĞ[660]] = !0; } return $’ÌóãÏí; } private function _moveForce($Ä°½ÑÎ×, $ÆüÊ–“ñ, $ß¸ßôö³) { $şé¿¶«¼ =& $_SERVER[ÆªÈ–¬]; $‘âìÄÉˆ = $this->sourceInfo($Ä°½ÑÎ×); $ ¼Ùî = $this->sourceInfo($ÆüÊ–“ñ); $Å¶Ÿ‚üÜ = $‘âìÄÉˆ[$şé¿¶«¼[485]] == $şé¿¶«¼[91]; $–¤í”‰š = array($şé¿¶«¼[477] => $ ¼Ùî[$şé¿¶«¼[193]], $şé¿¶«¼[652] => $ ¼Ùî[$şé¿¶«¼[584]] . $ ¼Ùî[$şé¿¶«¼[193]] . $şé¿¶«¼[50], $şé¿¶«¼[648] => $ ¼Ùî[$şé¿¶«¼[190]], $şé¿¶«¼[649] => $ ¼Ùî[$şé¿¶«¼[569]], $şé¿¶«¼[651] => USER_ID, $şé¿¶«¼[494] => $ß¸ßôö³); $ş¤š¹‡â = $‘âìÄÉˆ[$şé¿¶«¼[190]] == SourceModel::TYPE_GROUP && $ ¼Ùî[$şé¿¶«¼[190]] == SourceModel::TYPE_GROUP && $‘âìÄÉˆ[$şé¿¶«¼[569]] == $ ¼Ùî[$şé¿¶«¼[569]]; if (!$ş¤š¹‡â && $this->moveClearAuth) { Model($şé¿¶«¼[567])->authClear($Ä°½ÑÎ×); } $ı¯îïˆÎ = $‘âìÄÉˆ[$şé¿¶«¼[505]] == $şé¿¶«¼[91] && $ ¼Ùî[$şé¿¶«¼[505]] != $şé¿¶«¼[91]; if ($ı¯îïˆÎ) { $–¤í”‰š[$şé¿¶«¼[504]] = 0; } if ($Å¶Ÿ‚üÜ) { $àêØ­î° = array($şé¿¶«¼[652] => array($şé¿¶«¼[612], $‘âìÄÉˆ[$şé¿¶«¼[584]] . $‘âìÄÉˆ[$şé¿¶«¼[193]] . $şé¿¶«¼[613])); $ÏÈŒ¼Šª = $‘âìÄÉˆ[$şé¿¶«¼[584]] . $‘âìÄÉˆ[$şé¿¶«¼[193]] . $şé¿¶«¼[50]; $©ò»“­¡ = $ ¼Ùî[$şé¿¶«¼[584]] . $ ¼Ùî[$şé¿¶«¼[193]] . $şé¿¶«¼[50] . $‘âìÄÉˆ[$şé¿¶«¼[193]] . $şé¿¶«¼[50]; $êª¶–×Ú = array($şé¿¶«¼[652] => array($şé¿¶«¼[661], "\x72\145\x70\154\x61\143\x65\x28\x70\x61\x72\x65\x6e\164\114\x65\x76\145\x6c\x2c\47{$ÏÈŒ¼Šª}\x27\54\x27{$©ò»“­¡}\x27\51"), $şé¿¶«¼[648] => $ ¼Ùî[$şé¿¶«¼[190]], $şé¿¶«¼[649] => $ ¼Ùî[$şé¿¶«¼[569]]); if ($ı¯îïˆÎ) { $êª¶–×Ú[$şé¿¶«¼[504]] = 0; } $this->where($àêØ­î°)->data($êª¶–×Ú)->save(); } $this->where(array($şé¿¶«¼[491] => $Ä°½ÑÎ×))->data($–¤í”‰š)->save(); return $Ä°½ÑÎ×; } private function clearShare($•–¶§ğº, $¨ßÌ¨»„) { $±û¬¸ =& $_SERVER[ÆªÈ–¬]; $ø¯ÜÌÎÉ = $this->sourceInfo($•–¶§ğº); $Œƒı’ùÙ = $this->sourceInfo($¨ßÌ¨»„); if ($ø¯ÜÌÎÉ[$±û¬¸[569]] == $Œƒı’ùÙ[$±û¬¸[569]] && $ø¯ÜÌÎÉ[$±û¬¸[190]] == $±û¬¸[662]) { return; } $Ùó¶ºîø = array($±û¬¸[584] => array($±û¬¸[612], $ø¯ÜÌÎÉ[$±û¬¸[584]] . $•–¶§ğº . $±û¬¸[613])); $—¹ç½ë = $this->field($±û¬¸[491])->where($Ùó¶ºîø)->getField($±û¬¸[193], !0); if (!$—¹ç½ë) { return; } $Ùó¶ºîø = array($±û¬¸[193] => array($±û¬¸[7], $—¹ç½ë), $±û¬¸[663] => 1); $£âúëõ = Model($±û¬¸[664])->field($±û¬¸[665])->where($Ùó¶ºîø)->select(); if (!$£âúëõ) { return; } $£âúëõ = array_to_keyvalue($£âúëõ, $±û¬¸[12], $±û¬¸[665]); $Ùó¶ºîø = array($±û¬¸[665] => array($±û¬¸[7], $£âúëõ)); Model($±û¬¸[664])->where($Ùó¶ºîø)->save(array($±û¬¸[663] => 0)); Model($±û¬¸[666])->where($Ùó¶ºîø)->delete(); } public function copyFolderFromIO($ğÏå˜ş®, $ÇßÊİÉ, $Å°•¾Û, $´Ãì­ë, $ìµ½ˆ¥‹, $şÄ±Íç = false) { $½§ÔÁÍ =& $_SERVER[ÆªÈ–¬]; $®™åÁËı = array($½§ÔÁÍ[630] => array(), $½§ÔÁÍ[631] => array(), $½§ÔÁÍ[629] => array(), $½§ÔÁÍ[667] => array()); $¾ŠÑùËÒ = $şÄ±Íç ? $şÄ±Íç : $ğÏå˜ş®->pathThis($ÇßÊİÉ); $şõşôã = $this->fileNameExist($Å°•¾Û, $¾ŠÑùËÒ); $‘ÓÀ‹ = $this->mkdir($Å°•¾Û, $¾ŠÑùËÒ, $´Ãì­ë); if (!$şõşôã || $´Ãì­ë == REPEAT_RENAME_FOLDER) { $´Ãì­ë = !1; } if ($şõşôã) { $this->_childrenAllMake($şõşôã); } Hook::trigger($½§ÔÁÍ[668]); $this->_copyChildTo($ğÏå˜ş®, $ÇßÊİÉ, $‘ÓÀ‹, $´Ãì­ë, $®™åÁËı, $ìµ½ˆ¥‹); Hook::trigger($½§ÔÁÍ[669]); if ($‘ÓÀ‹) { $this->folderSizeResetChildren($‘ÓÀ‹); } $this->_childrenListClear(); Model($½§ÔÁÍ[632])->addAll($®™åÁËı[$½§ÔÁÍ[630]], array(), !0); Model($½§ÔÁÍ[633])->eventCopy($‘ÓÀ‹); $this->saveAll($®™åÁËı[$½§ÔÁÍ[631]]); Model($½§ÔÁÍ[544])->linkAdd($®™åÁËı[$½§ÔÁÍ[629]]); Model($½§ÔÁÍ[544])->remove($®™åÁËı[$½§ÔÁÍ[667]]); $this->folderSizeReset($Å°•¾Û); $this->updateModifyTime($Å°•¾Û); return $‘ÓÀ‹; } private function _copyChildTo($ïÖëŠ¹ø, $şÃìçŞ…, $œ øÀš, $¼§šÏêÙ, &$üüĞöËˆ, $²èÔº”¯) { $ï¡í…Ú =& $_SERVER[ÆªÈ–¬]; $ÔŠ¼û˜ = $this->sourceInfoCache($œ øÀš); $İ¯Æêô† = $ïÖëŠ¹ø->listPath($şÃìçŞ…); $İ¯Æêô† = $İ¯Æêô† ? $İ¯Æêô† : array($ï¡í…Ú[86] => array(), $ï¡í…Ú[85] => array()); $õƒøëêÄ = array_merge($İ¯Æêô†[$ï¡í…Ú[86]], $İ¯Æêô†[$ï¡í…Ú[85]]); $¹óò†ñÉ = $this->_addFiles($ïÖëŠ¹ø, $İ¯Æêô†[$ï¡í…Ú[86]], $²èÔº”¯); $„ò³à‹¥ = array(); foreach ($õƒøëêÄ as &$¿Š÷Œ¬®) { if (isset($¹óò†ñÉ[$¿Š÷Œ¬®[$ï¡í…Ú[32]]])) { $¿Š÷Œ¬® = $¹óò†ñÉ[$¿Š÷Œ¬®[$ï¡í…Ú[32]]]; } $¿Š÷Œ¬®[$ï¡í…Ú[485]] = $¿Š÷Œ¬®[$ï¡í…Ú[33]] == $ï¡í…Ú[78]; $¿Š÷Œ¬®[$ï¡í…Ú[486]] = substr(_get($¿Š÷Œ¬®, $ï¡í…Ú[169], $ï¡í…Ú[12]), 0, 10); $¿Š÷Œ¬®[$ï¡í…Ú[79]] = _get($¿Š÷Œ¬®, $ï¡í…Ú[79], 0); $¿Š÷Œ¬®[$ï¡í…Ú[541]] = _get($¿Š÷Œ¬®, $ï¡í…Ú[541], 0); if (!isset($¿Š÷Œ¬®[$ï¡í…Ú[670]]) && $¿Š÷Œ¬®[$ï¡í…Ú[541]]) { $üüĞöËˆ[$ï¡í…Ú[667]][] = $¿Š÷Œ¬®[$ï¡í…Ú[541]]; } if ($¼§šÏêÙ) { $‰àî½± = $this->fileNameExistCache($œ øÀš, $¿Š÷Œ¬®[$ï¡í…Ú[32]]); if ($‰àî½±) { if ($¿Š÷Œ¬®[$ï¡í…Ú[485]] || $¼§šÏêÙ == REPEAT_SKIP) { continue; } if ($¼§šÏêÙ == REPEAT_REPLACE) { $«ıä£–« = $this->sourceInfoCache($‰àî½±); $â­±ù“ = $this->fileHistory($«ıä£–«, $¿Š÷Œ¬®[$ï¡í…Ú[541]], $¿Š÷Œ¬®[$ï¡í…Ú[79]]); if ($â­±ù“) { $üüĞöËˆ[$ï¡í…Ú[629]][] = $¿Š÷Œ¬®[$ï¡í…Ú[541]]; } continue; } else { if ($¼§šÏêÙ == REPEAT_RENAME) { $¿Š÷Œ¬®[$ï¡í…Ú[32]] = $this->fileNameAutoCache($œ øÀš, $¿Š÷Œ¬®[$ï¡í…Ú[32]], $¼§šÏêÙ, !1); } } } } if (!$¿Š÷Œ¬®[$ï¡í…Ú[485]] && $¿Š÷Œ¬®[$ï¡í…Ú[541]] == 0) { continue; } if (!$¿Š÷Œ¬®[$ï¡í…Ú[485]] && $¿Š÷Œ¬®[$ï¡í…Ú[541]]) { $üüĞöËˆ[$ï¡í…Ú[629]][] = $¿Š÷Œ¬®[$ï¡í…Ú[541]]; } $„ò³à‹¥[] = $this->_makeItemData($¿Š÷Œ¬®, $ÔŠ¼û˜, $¿Š÷Œ¬®[$ï¡í…Ú[32]]); } unset($¿Š÷Œ¬®); if (!empty($„ò³à‹¥)) { $this->addAll($„ò³à‹¥); $this->_childrenListSelect($œ øÀš); } $É§¥ûê¢ = $this->_childrenList($œ øÀš); $É§¥ûê¢ = array_to_keyvalue($É§¥ûê¢, $ï¡í…Ú[32]); foreach ($õƒøëêÄ as $¿Š÷Œ¬®) { $«ıä£–« = $É§¥ûê¢[$¿Š÷Œ¬®[$ï¡í…Ú[32]]]; $š‘ší = $«ıä£–«[$ï¡í…Ú[193]]; $this->_copyApplyMeta($«ıä£–«, $üüĞöËˆ); if ($¿Š÷Œ¬®[$ï¡í…Ú[33]] == $ï¡í…Ú[78]) { $¿Š÷Œ¬®[$ï¡í…Ú[87]] = $ïÖëŠ¹ø->getPathInner($¿Š÷Œ¬®[$ï¡í…Ú[87]]); $this->_copyChildTo($ïÖëŠ¹ø, $¿Š÷Œ¬®[$ï¡í…Ú[87]], $š‘ší, $¼§šÏêÙ, $üüĞöËˆ, $²èÔº”¯); } } } private function _addFiles($è“®Ù¯ø, $À©å¡»¾, $–±ÊÍø) { $…áéïƒ¡ =& $_SERVER[ÆªÈ–¬]; if (!$À©å¡»¾ || count($À©å¡»¾) == 0) { return array(); } $‡à«™¼˜ = array(); foreach ($À©å¡»¾ as &$êö¦—˜ê) { Hook::trigger($…áéïƒ¡[671], $êö¦—˜ê); $êö¦—˜ê[$…áéïƒ¡[87]] = $è“®Ù¯ø->getPathInner($êö¦—˜ê[$…áéïƒ¡[87]]); $³òŠÉÇ´ = $è“®Ù¯ø->hashSimple($êö¦—˜ê[$…áéïƒ¡[87]]); $øû¾Ïğ€ = $è“®Ù¯ø->hashMd5($êö¦—˜ê[$…áéïƒ¡[87]]); if (strlen($øû¾Ïğ€) > 10 && !isset($‡à«™¼˜[$øû¾Ïğ€])) { $‡à«™¼˜[$øû¾Ïğ€] = array(); } $êö¦—˜ê[$…áéïƒ¡[672]] = $³òŠÉÇ´; $êö¦—˜ê[$…áéïƒ¡[547]] = $øû¾Ïğ€; $‡à«™¼˜[$øû¾Ïğ€][] =& $êö¦—˜ê; if (count($‡à«™¼˜[$øû¾Ïğ€]) > 1) { $êö¦—˜ê[$…áéïƒ¡[670]] = !0; } Hook::trigger($…áéïƒ¡[673], $êö¦—˜ê); } unset($êö¦—˜ê); $çÊ²çé¶ = array($…áéïƒ¡[547] => array($…áéïƒ¡[7], array_keys($‡à«™¼˜))); $‹îÃ¯Âş = Model($…áéïƒ¡[674]); $•ƒÕ¢ëé = $‹îÃ¯Âş->where($çÊ²çé¶)->select(); $•ƒÕ¢ëé = $•ƒÕ¢ëé ? $•ƒÕ¢ëé : array(); foreach ($•ƒÕ¢ëé as $êæ•Ú­ú) { if (!isset($‡à«™¼˜[$êæ•Ú­ú[$…áéïƒ¡[547]]])) { continue; } $³«õôÆŠ = $‡à«™¼˜[$êæ•Ú­ú[$…áéïƒ¡[547]]]; foreach ($³«õôÆŠ as &$êö¦—˜ê) { $êö¦—˜ê[$…áéïƒ¡[541]] = $êæ•Ú­ú[$…áéïƒ¡[541]]; $êö¦—˜ê[$…áéïƒ¡[670]] = !0; } unset($êö¦—˜ê); } $åÜœ«£– = array(); foreach ($À©å¡»¾ as $†·à…Œ) { Hook::trigger($…áéïƒ¡[675], $†·à…Œ); if (isset($†·à…Œ[$…áéïƒ¡[670]]) && $†·à…Œ[$…áéïƒ¡[670]]) { Hook::trigger($…áéïƒ¡[676], $†·à…Œ); continue; } $¤µ³ÛÜ = $è“®Ù¯ø->getPathInner($†·à…Œ[$…áéïƒ¡[87]]); $…ê°¶°Â = $‹îÃ¯Âş->addFileMake($¤µ³ÛÜ, $†·à…Œ[$…áéïƒ¡[79]], $†·à…Œ[$…áéïƒ¡[672]], $†·à…Œ[$…áéïƒ¡[547]], $†·à…Œ[$…áéïƒ¡[32]], $–±ÊÍø); Hook::trigger($…áéïƒ¡[676], $†·à…Œ); if (!is_array($…ê°¶°Â)) { continue; } $åÜœ«£–[] = $…ê°¶°Â; } $‹îÃ¯Âş->addAll($åÜœ«£–); $çÊ²çé¶ = array($…áéïƒ¡[547] => array($…áéïƒ¡[7], array_keys($‡à«™¼˜))); $•ƒÕ¢ëé = $‹îÃ¯Âş->where($çÊ²çé¶)->select(); $•ƒÕ¢ëé = $•ƒÕ¢ëé ? $•ƒÕ¢ëé : array(); foreach ($•ƒÕ¢ëé as $êæ•Ú­ú) { if (!isset($‡à«™¼˜[$êæ•Ú­ú[$…áéïƒ¡[547]]])) { continue; } $Ş²µ—Õ =& $‡à«™¼˜[$êæ•Ú­ú[$…áéïƒ¡[547]]]; foreach ($Ş²µ—Õ as &$êö¦—˜ê) { $êö¦—˜ê[$…áéïƒ¡[541]] = $êæ•Ú­ú[$…áéïƒ¡[541]]; } unset($êö¦—˜ê); } $Ğ’Á™° = array(); foreach ($À©å¡»¾ as $…ê’ËÀÛ) { $Ğ’Á™°[$…ê’ËÀÛ[$…áéïƒ¡[32]]] = $…ê’ËÀÛ; } return $Ğ’Á™°; } } define($_SERVER[ÆªÈ–¬][677], $_SERVER[ÆªÈ–¬][678]); $tjgnzefxcd = $_SERVER[ÆªÈ–¬][679]; goto Fïó†Ü¾œ; c«­œî¬¹©: class CacheLockRedis { public function lock($Œœ¼»áÎ, $ùšİã¶ = 10) { $îİÀîƒ = Cache::init(); $ïŸâÒõÖ = microtime(!0) + $ùšİã¶; while (microtime(!0) < $ïŸâÒõÖ) { $ñÁê²öº = $îİÀîƒ->get($Œœ¼»áÎ); if (!$ñÁê²öº) { $˜½×…©° = $îİÀîƒ->setLock($Œœ¼»áÎ, $ïŸâÒõÖ, $ùšİã¶); if ($˜½×…©°) { return !0; } } else { if ($ñÁê²öº < microtime(!0)) { $îİÀîƒ->set($Œœ¼»áÎ, $ïŸâÒõÖ, $ùšİã¶ * 2); if ($îİÀîƒ->get($Œœ¼»áÎ) === $ñÁê²öº) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ƒ“¯¿ˆ) { return Cache::init()->get($ƒ“¯¿ˆ); } public function unlock($Èš–Ì·Ÿ) { return Cache::init()->remove($Èš–Ì·Ÿ); } } class CacheLockMemcached { public function lock($ú‡ÓÜõô, $òÉø²‹› = 0) { $¯®ïšÏ¥ = Cache::init(); $ïŞéİö = microtime(!0) + $òÉø²‹›; while (microtime(!0) < $ïŞéİö) { $œçìçó² = $¯®ïšÏ¥->get($ú‡ÓÜõô); if (!$œçìçó² || $œçìçó² < microtime(!0)) { $ßà‡óêñ = $¯®ïšÏ¥->handle->add($ú‡ÓÜõô, $ïŞéİö, $òÉø²‹›); if ($ßà‡óêñ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¢³§üÛ) { return Cache::init()->get($¢³§üÛ); } public function unlock($Ğ „·Ó½) { return Cache::init()->remove($Ğ „·Ó½); } } class CacheLockDatabase { public function lock($Ë†î·Ğ, $’ëÖß è = 0) { $œ‰¡ü¼ù = Model($_SERVER[ÆªÈ–¬][902]); $É„Å¦¶× = microtime(!0) + $’ëÖß è; while (microtime(!0) < $É„Å¦¶×) { $˜¯÷‡äÚ = $œ‰¡ü¼ù->get($Ë†î·Ğ); if (!$˜¯÷‡äÚ || $˜¯÷‡äÚ < microtime(!0)) { $ÄÓèı•¼ = $œ‰¡ü¼ù->set($Ë†î·Ğ, $É„Å¦¶×); if ($ÄÓèı•¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Îº×Ç¾ù) { return Model($_SERVER[ÆªÈ–¬][902])->get($Îº×Ç¾ù); } public function unlock($Ñ»ïææ¶) { Model($_SERVER[ÆªÈ–¬][902])->remove($Ñ»ïææ¶); } } goto a¶‡Ï«óôš; AÕ¦Ìêä‰£: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xc6\xaa\xc8\x81\x96\xac", base64_decode('xZbvt8nW')); $_SERVER[ÆªÈ–¬] = explode(strrev('|||'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\133\305\325\50\177\13\55\244\145\51\360\267\120\226\336\230\4\333\211\26\333\331\235\70\101\226\345\130\104\226\214\44\147\301\66\67\327\322"."\265\164\155\111\127\326\275\362\226\244\45\241\254\41\20\366\245\224\226\355\25\12\204\245\120\122\2\245\355\317\132\112\151\137\313\136\240\245\330\111\12\64\55\133\241\205\362\146\71\263\334\53"."\x19\xfe\xf7\xfd\xef\xfb\x5e\x20\xd1\xcc\x99\x33\x73\x67\x39\x73\xe6\xcc\x99\x33\x67\x7e\xb0\xfb\xb9\xbb\xaf\xd8\xb7\xf1\x3f\xf0\x7f\xf\x3f\xf2\xc8\xcb\x7f\x3e\x87\x86\x37\xee\xbf\xf1\x0\xf4\x1f\x9\x7f\x63"."\353\201\373\221\77\107\154\75\257\256\256\143\341\214\271\321\57\137\170\317\355\332\55\332\355\332\266\130\344\311\137\205\17\376\365\155\47\207\246\156\170\162\174\352\77\366\363\315\73\363\236\146".strrev('±£WKs†³şEêÑõu´ŞzJGéı?_Ğ(Øhd`0³)E¶Xf>ŠÚ`¥Ó6óL„')."\244\232\350\356\352\12\305\223\200\324\54\247\347\315\64\204\212\132\111\313\303\367\213\172\311\102\265\221\213\123\213\146\121\57\70\40\2\220\326\154\255\137\263\240\244\266\126\265\55\324\25\211"."\xad\x53\x93\xeb\xba\x42\x80\xd1\xaf\xe\x97\xf5\xd2\x38\x8d\x91\x60\xc2\xd6\x4a\x76\xd2\xc8\xeb\x1c\x63\xb4\xc4\xeb\xd5\x1a\x5a\x19\x8e\x2a\xc9\x78\x20\x9a\x8\x4\x93\xe1\x58\x94\x82\x83\xb1\xce\xce\x70\xb2".base64_decode('Eh6PRSKtgeCqypSueGBlZ0BB9cvpqlEYMOuU9TRlvVJPA+2GnkvTYEFj1bHHixBK8hAapg==').strrev('B%E'."\0".'½h×TpIvcBFŠB6ÙZJãéW£X×‘’Å#“jŞƒœ­õ¥(‘£—9B').strrev('•O41YÏ[®™DH(WQD½'."\0".'«ZÚKRİ+‚ñB:k)/[,×ƒ§Xñí*'."\n".'à©0P‘')."\xc2\x62\xf1\xb6\x50\x5c\x69\x5d\xa7\x88\x1e\x4a\x99\xf9\xbc\x59\xf0\xa1\x52\xd0\x48\xda\x52\x55\x43\xf1\x38\xd\x78\x80\xbc\x23\x61\x3c\x68\x10\x89\xb5\xb7\x27\x42\x3c\x6\x8d\x3b\x25\x82\x6a\x32\xf\xe8\xd3"."\x11\x4b\xf\xe4\x6c\x75\x44\xcb\x95\x19\x99\xe\xd1\xdf\x5a\xf8\x81\x5f\xd3\x2\xd2\x1d\x36\xa\x46\x19\xc8\x14\x8a\x30\x4d\x3e\xad\x20\x50\x66\xd8\x3a\x83\xe8\x69\x8\xe4\x51\x7e\x13\xf2\xf5\x3\xac\x9f\x61"."\xd\xb2\x80\x81\x66\xe8\x8\xd\xb6\x2c\xa7\xbf\x4b\x21\x7f\xbf\x8a\xd3\xf4\x92\xad\xea\x85\x94\x99\x36\xa\x30\x8f\x57\x0\x3d\x6a\x76\xb6\xad\x64\x20\x4\x1a\x1f\x30\x73\x69\x16\xb6\x8c\x9\x68\xe5\x80\x91"."\323\243\345\274\214\302\243\251\254\221\113\227\330\324\373\64\114\32\215\360\231\214\161\105\254\210\152\2\165\106\325\34\30\27\123\21\343\165\361\124\313\54\227\122\172\30\115\35\32\157\4\260"."\x6e\xdb\xa8\x71\xac\x43\xcc\xee\x62\xce\xd4\xd2\x9\xbd\xc4\x9b\x66\x98\xed\xa8\xa0\x58\xd9\x96\x81\x65\x82\xd6\x6e\x96\xf2\x6d\x88\x69\xc0\xf7\xd1\x84\x31\xba\xab\x24\xc\xb1\x29\x93\x96\x7a\xcc\x5f\xd7\xb3"."\331\373\357\276\236\223\320\77\365\300\25\173\241\116\131\75\227\123\365\61\35\346\124\76\275\300\142\235\341\267\372\215\202\37\101\150\64\34\123\263\232\225\355\114\57\120\111\56\250\162\41\255"."\217\371\212\331\42\215\212\331\336\353\240\171\334\165\121\323\16\111\54\73\147\246\264\234\334\104\32\316\332\166\61\241\27\322\270\47\240\51\346\150\201\364\124\121\327\1\251\315\243\244\225\116".base64_decode('ZZ3S0Ww0WyxjPsdDrHUcZnGgPcaGMz0A1MpWjBr4oGER5idmrlYs5oyUZhtmwW+mbN32Wg==')."\x76\x49\xd7\xa0\xc4\x40\x2a\xa5\x5b\x96\x37\x68\x16\xec\x92\x99\xf3\x6\x72\x39\x73\xd4\x1b\x2b\x19\x19\xa3\xd0\xac\xcc\xa1\x38\x38\x11\xcd\x77\x2f\xe6\x8d\xcd\x30\x89\x6b\x96\x2a\x98\x70\xf0\x67\xe6\xb4\x94"."\355\1\357\142\66\71\71\166\111\53\130\3\172\311\33\202\231\321\254\240\312\162\6\311\320\332\14\253\150\132\6\256\136\263\242\331\266\226\312\142\346\42\212\157\371\24\174\243\220\63\12\172".strrev('¼¢&vVV­bİ%+•†Z¼Æ×’³@t22Â–!0Ô~åŠVk^L´•v÷D*.%').base64_decode('eCIZetqbQNwbCpvXMF9BtKKwNArtSCa71HA7Wp6jIbUzkAx2QOm2lmFFRxBP5kUy4Fovmg==').strrev('-©¼š[qşŒÜ'."\n".'×ÛE¾<d0³ˆ‘„–>c›÷LÈefñÖáô%êeØq¨¢š˜P')."\xe6\xbe\x1\x3a\x7b\x7d\xfd\xfa\x80\x59\x82\xd6\x58\x23\x19\x67\xe7\x47\xf4\x42\xc6\xce\xb2\xb2\x13\xa1\xf8\xea\x50\x5c\x4d\xc4\xda\x93\x6b\x2\x71\x58\xfb\xb\x88\x72\xc6\x58\x6d\xf0\xd7\x73\xde\xb8\x9e\x46"."\x9d\x98\xb2\x59\x3e\xad\x28\x7a\x7f\xad\x17\x4f\x18\xfc\x71\x96\x8a\x27\x11\x4b\x8b\x84\x57\xe2\xbe\x6b\xf3\x5a\x8\xc9\x2b\x63\xb1\xb2\x23\x46\xde\xc0\xcd\xb3\x79\xa\xe9\x6c\x24\x18\xac\x84\xa\xf9\x49\x9b"."\x5b\x7a\xad\x39\x75\xbd\xe9\xb9\xf5\x5e\xf4\xef\x9c\xfa\x9e\xde\x36\xdf\x9c\xbe\x15\x7e\x43\xe4\xf1\x37\xfa\x1a\x95\xa6\x86\x85\x4a\x17\x92\x54\xc\x2d\xa7\x40\xa3\x2b\x30\x1a\x94\xd8\x2a\x67\xb7\x8\xa\x2f"."\x98\x5\xbd\xea\xc4\x42\x84\x64\x5a\xba\xb7\x43\xd7\x10\x93\x46\x3\xe1\x18\x17\xf\xfb\x16\x8d\x7f\x4a\xef\xe2\xb5\x52\xe2\x25\xae\x71\xa1\xc0\x78\xe8\x94\xee\x50\x22\xa9\x76\x86\x92\x1d\xb1\x36\xa8\x7e\x28".base64_decode('AKECykzqy8YYC2Y0iPoYAmPSGiLWgpTcISRf1BylMcN0EVAwq6eGpklDIWiNSfkSG7oe+g==')."\323\7\324\334\107\177\124\303\152\227\326\115\34\345\374\125\65\373\7\21\145\165\352\154\21\201\57\205\363\150\16\213\232\253\316\105\216\65\253\123\120\72\232\62\153\214\64\137\5\121\264\103"."\x37\x32\x59\xa8\xa8\x81\x8b\x4b\x99\x39\xb3\xa4\xe5\x30\xef\x67\x82\x6b\xc6\x0\x36\x5c\xcc\x95\x11\xdd\xfb\x71\xc1\xc9\x6c\x39\xdf\xf\x2b\x15\xea\xa3\x8c\x6e\xb\x99\xd2\x1a\x47\x82\x17\x70\x5e\x24\x82\xa3"."\xce\xc\xc3\xb0\xc0\xba\xb\x31\xbf\x8a\x69\xb5\xd7\x57\x2c\x64\xea\x67\x41\x59\x6a\xd3\x82\x6\xc\x80\x61\x84\x96\x21\xe1\xba\xac\x57\x36\xdd\x97\x32\xd1\xc4\xee\xd4\x86\xf4\x66\xdc\x16\xe0\x66\x4b\x9\x94"."\105\44\206\271\24\257\161\55\156\276\200\207\47\347\313\243\102\110\231\101\223\257\312\164\373\2\102\20\133\343\24\275\124\62\113\63\1\203\204\25\262\120\342\341\202\302\155\56\166\130\210\5".base64_decode('sHDW5GKKyYix2Q/tnt3UDmwjjcQ1n2WjQUAN1NLpamDEaqCAjYxOSQKNhGP+xDz0v1j00w==').strrev(''."\0".'4@&ueÓ´ĞÖ<ŞeU¡èhf¡5˜”DÀä±8›d·+h)m: ı]4ôüY(Kc^f').base64_decode('Gup+TmMDnNjRFgFBheRmWHGUEy/3LL4G76kEAMs8QDwimENDFyOzRsS7SvqAAVy7gGZ/pw==')."\126\32\142\15\103\71\305\174\303\21\151\56\266\167\107\42\152\60\26\115\242\55\31\205\254\211\207\223\300\253\342\210\347\250\201\140\27\304\4\147\343\142\231\54\130\120\310\110\23\320\11\252"."\204\137\110\100\150\11\56\232\5\304\77\201\5\171\305\206\255\42\51\55\4\4\40\20\41\124\270\344\4\264\322\347\47\274\171\304\74\274\274\116\116\361\114\201\345\236\112\171\141\30\246\64"."\x1f\x1c\xdc\x79\x68\x22\x33\xb9\xb0\x2b\x96\x80\xc\x2b\x30\x14\xc9\xe6\xfd\x7c\xbe\x75\x75\x43\x52\x5e\x22\x91\x95\x21\x0\xce\x0\xaa\xca\x6a\x8d\x40\x4f\x6b\x12\x6c\x9\x2f\x23\xfc\x92\x31\xa1\x89\x26\xad"."\x60\xf5\x61\xd\xc9\xe7\x84\xa8\xef\x6c\x95\x57\x8c\x7c\xd9\xf2\xea\x58\xca\x10\x5f\x98\xef\xed\xe8\xc\x4\xbd\x89\x8e\x40\xd3\x82\x85\x14\xba\x2e\x9f\xee\x4d\x76\x18\x56\xef\xa9\x3c\xe\xdd\x38\x6a\xcd\x57".strrev('¢b–Œ&Ä59W}±(É¤,Ù¨|E’¡w5•¡¡¯ ÷./y¼ëz©$¥’P'."\r".'MCì8b:K')."\57\136\145\54\357\250\301\70\363\54\276\113\230\125\111\75\263\234\353\41\24\121\46\53\261\252\245\360\307\124\124\242\135\266\344\236\102\323\52\215\62\31\114\242\247\120\55\227\101\235\156\147"."\363\62\120\14\74\215\353\124\74\344\143\307\173\21\367\255\223\306\345\52\25\115\44\220\102\63\326\126\255\303\332\152\165\130\353\252\303\332\312\72\120\220\145\144\12\250\225\154\161\203\341\130"."\211\207\103\32\126\307\60\217\251\50\243\12\163\110\225\233\2\235\4\315\220\123\72\70\67\143\215\354\154\133\300\352\21\350\74\325\333\26\140\274\140\331\12\104\242\312\10\326\64\231\205\226"."\332\106\137\103\255\302\166\314\55\265\335\311\166\264\177\130\261\174\306\262\240\231\57\142\306\330\211\67\211\170\12\321\215\342\162\230\36\313\260\154\306\42\135\174\206\321\170\50\251\301\342\270"."\314\57\343\55\363\117\127\52\20\133\136\233\60\13\210\274\321\242\231\367\245\200\206\261\30\312\327\40\34\261\170\54\331\21\216\256\122\73\143\155\241\210\32\216\42\71\55\131\11\357\356\22"."\x8d\x97\xe1\xad\xb1\x64\x87\x3\xda\x8d\x24\xb5\xd5\x81\x48\xd8\x8d\x1e\x5a\x1b\x4e\x24\x13\x55\x93\x10\xac\x3b\xe4\x4a\x69\x6b\x55\xbb\xe2\xa1\xf6\xf0\x5a\x1e\x6d\xf\x87\x22\x6d\x9\x35\x18\x8\x76\x8\x9c"."\x68\xa0\x13\x22\x48\x24\xd2\x73\x69\xcb\xef\xc4\x57\x91\xc8\x99\xe0\xea\x34\x15\x6\xc\x62\xe\xd\x96\xca\x74\x33\xaa\xe0\xc5\x68\xfb\xa2\x3\x1\x43\x73\xb1\x42\x92\xb4\x44\x65\x93\xbe\xcc\x5\x48\xb6\x57"."\317\263\305\26\155\275\140\104\330\276\243\216\376\324\53\201\204\142\27\241\14\264\254\366\217\363\40\151\6\213\43\141\3\276\257\200\370\133\121\3\25\343\264\112\233\234\352\200\300\200\315\5"."\116\127\34\55\42\42\15\215\100\200\150\76\21\45\220\21\201\317\30\150\111\52\331\1\126\235\1\241\165\124\143\135\241\170\0\353\54\325\65\361\130\164\45\144\30\315\352\254\2\141\350\376"."\x3a\xb6\xeb\x4\xd5\xa5\x2d\x56\x76\x2d\x67\x68\x4c\x87\x25\x3a\x7d\xd0\x64\x5d\x79\x22\xfd\x41\x1b\x6e\x26\xd2\x17\x58\x77\xf7\x63\xe9\x86\xc9\xb5\x2c\x30\x80\xe6\x3\x93\x4c\xcc\x32\xff\x4c\xbf\x69\x42\xd1"."\71\274\317\242\101\304\154\270\316\163\320\142\324\61\306\326\352\271\360\301\61\220\260\222\261\125\241\250\312\110\212\306\44\62\244\200\120\74\36\213\103\117\330\346\20\323\167\321\304\170\50\301".base64_decode('lkm8/hisn/y+uUC+OhLi4PP+03pH59b1eOf6+lCgfs5JNAqxXp8jymTrconnxlO9zlpR3w==')."\334\353\357\365\327\255\150\356\11\170\47\64\357\104\203\167\211\267\17\111\344\365\163\1\320\267\241\311\63\177\23\106\100\210\53\116\350\103\77\55\275\53\146\367\172\117\374\346\372\223\172\172"."\373\152\233\347\316\354\365\235\320\73\332\67\247\176\5\373\116\252\134\102\102\77\143\375\250\252\351\271\165\250\112\150\133\312\121\12\22\107\43\10\54\141\302\50\12\350\206\205\233\30\34\215"."\241\236\21\71\172\274\275\163\373\126\110\371\44\220\373\133\150\111\102\2\114\226\343\5\274\247\342\226\361\254\170\302\3\175\224\13\51\261\276\343\11\321\257\361\375\135\246\40\366\121\166\211"."\353\100\107\20\221\212\305\152\303\154\372\273\211\15\144\106\207\331\116\316\77\112\100\235\345\202\61\314\66\64\5\175\30\2\246\315\10\273\137\267\107\165\106\36\10\356\210\43\342\140\13\50"."\x4a\x92\x62\x39\x69\xf1\x25\xca\x2a\x4e\xa3\x9c\x98\x8c\xa2\x8a\xf7\x76\xa3\x3c\x86\xd6\x63\x18\xa7\x83\x0\xdb\x4a\x69\x45\x3d\x21\xb5\x50\x55\x93\x81\xd6\x48\x48\x65\xac\x5\x58\x30\x8b\x13\x76\xd8\xca\x4f"."\x4a\x50\xd3\x4\x2b\x65\x8c\x41\x52\x44\x11\xc5\x10\x4c\x79\x6b\x38\xa7\x10\x8e\x40\x37\x55\xcd\xe4\xd0\xc8\x2a\x17\xf1\xfe\x48\x41\x23\x8e\xfa\x56\x41\x92\x90\xd2\xb2\x5c\xa1\x5d\xe\xf9\x54\x79\x0\x8a\x7c".strrev('*Ç*"Ãú/Úgªmæ}¼×Â õ÷OG¹oo]›a%´,„bŠA5˜ô˜º™5ƒß')."\x67\x83\x2a\x12\x70\x7d\xb8\x1e\x5c\x4d\xed\x88\xf0\x64\x1a\x35\x4b\x7c\x67\x51\x74\xec\xdf\x6d\xd3\xd6\x72\x8e\x22\x92\x18\x2\x83\xcb\x25\x5f\x50\xd8\xd2\xd1\x8e\x8\x8e\x85\x65\x61\xe9\xdc\x87\xf0\xd1\x28"."\x57\x90\x72\x89\x52\x3a\x78\xc0\x39\x12\xba\xed\xe3\x18\x1e\x29\x51\x45\x71\xc7\x19\x5c\xb\x28\x5f\x7\x8c\x2\x9a\x4e\x41\x69\x8d\xa3\x6a\xf3\x4\xd9\xf6\x3b\xe\x8b\x2c\x5d\x2b\xa5\xb2\xed\xe5\x5c\xce\xe6"."\xda\x96\x9c\x31\x4\x5f\x80\xb9\x2\x67\x57\x5e\xfa\xa3\xcc\xad\x96\xb5\xdd\x2c\x31\xe5\xe3\x1c\xa8\x46\xcd\x9c\x6a\x88\xe1\x42\xc1\x4c\xf7\xcb\xa4\x26\x56\xd7\x95\x1\x24\xc7\x24\x95\x3a\x76\xce\xa2\x84\xa3"."\x4a\x6b\x2c\x16\x9\x5\xa2\xa\x5e\xc8\x61\x1\x42\x52\x42\x22\xd4\x15\x40\xab\x17\x56\x63\x26\x92\x21\x38\xfa\x9\xb7\x79\x59\xb9\x6b\xbd\x4c\x87\xc1\x3\x6\x74\xbb\x59\xa4\x2\xb8\x6e\xab\x39\x93\x31\xf"."\xa7\x16\x4\xef\xcd\x3c\x58\x17\xe1\xc1\x42\x85\x7\xd5\xda\x83\xd5\x17\x1e\xb1\xf3\xf5\x88\xe3\xb\xcf\x88\xa1\x8f\x92\x0\xdf\x95\x7a\x60\xb3\xea\x11\x8a\x17\x8\x86\xdb\x3c\x86\xd5\x46\x36\xdd\xe4\x3\x24".strrev('ÇŠÄzı0€˜=fkˆ‚Eª	ÓFêÕÔD<¢)‡£«*aç=ôDêĞ÷Nr­bÎÁU‰')."\x1c\x2d\xe8\x25\x82\x2\x1d\x23\xf6\xeb\x1e\xb1\x97\xf7\x64\x4a\x66\xb9\xd8\xc5\xbe\x29\xc5\x68\xb5\x0\x20\xea\xcc\x1\x71\xd3\xb4\x3d\x4c\xb7\xe5\x91\x95\x5c\x50\x8b\x0\x9b\x27\x55\xbb\xb3\x7a\x6b\x48\xff".strrev('-sV-ÑÁ®ĞŠ‰‹V„\\;‰Ø¸Ùè‡œ«bnfPD´'."\r".'½úœ<r«3é{*“…ô+»')."\x38\x9\x55\x9c\x9d\x88\x53\x33\x21\xe4\xba\xb5\x30\xee\xf3\x34\xfc\x51\xb4\x13\x49\x48\x9f\xb3\xb5\xc\xfb\x16\x66\x56\x7c\x9f\x52\x5\x95\x86\xe3\x7a\x6a\x3c\x25\xd4\x3a\x6d\x92\xb2\xc8\x19\x2b\xa3\x12\x12"."\332\200\253\131\36\62\217\252\315\201\352\143\314\351\232\17\311\214\203\16\142\175\314\210\235\217\257\143\216\174\366\354\204\166\21\26\30\53\12\41\202\126\26\263\341\4\132\324\332\163\254\123".base64_decode('muRkYMAeZwxPLh9hyOSEOsGVhpFQe1I5OYa4l2GqNI+KkRXyj1lQHGWz7lJaSLqIa4U0hQ==')."\xac\x47\x9c\x7e\x7d\x4b\xd\xfb\x48\x8d\x23\xbb\x20\x13\x67\x25\x3c\x2c\xea\xf8\x9a\x18\x71\xb9\x13\x30\x39\x90\xe6\x8b\xd5\x89\x81\x62\x62\x31\x2c\x83\xe4\xa7\x59\xb0\xf9\xc2\x2a\x57\x8\xe9\xc\x26\x86\x56".base64_decode('pkuJ3QgAq5fjuzgq5hQjCQV/AAogsgpmKV4xO6Sos8tdFOlaQnEXdRmFcaOQMPDe3A2FGg==')."\3\23\25\223\133\304\50\125\116\27\246\213\10\126\175\321\362\75\160\374\353\311\31\205\41\151\201\26\232\115\124\173\234\125\252\73\224\344\252\71\24\44\241\210\36\200\371\14\24\237\325\112"."\242\63\31\27\302\254\200\267\301\302\50\42\52\241\15\150\43\102\100\161\344\221\170\211\145\217\263\332\313\101\147\241\64\332\346\41\277\35\250\362\362\164\345\303\203\371\10\103\242\54\10\361"."\202\10\352\53\364\103\32\222\64\75\130\167\217\176\350\62\316\54\1\10\22\243\373\162\276\15\316\2\160\170\65\142\0\100\70\270\303\353\30\3\1\141\102\225\164\1\234\1\71\305\1\132"."\x93\x0\x67\xef\x48\x5e\xcf\xa1\xd5\xac\xe4\xc3\x73\x64\x25\x5e\x93\x58\x9f\x50\xf6\x26\xd3\x5c\x42\x47\xed\x84\xe2\x45\x9\x89\x8a\x34\x19\x5b\xe8\x50\x31\xbb\x17\xcb\x3\x3f\x0\xe3\x53\x4c\xf4\xaf\x98\x4f".strrev('àµ¦¸_,Q]Ap–[) Hpş¥ZáĞnG»$İ•òÜ.L—·W0=ejÜ!Q').strrev('Ê¼'."\r".'A€ãÄ¨²ú¾K4mM¶q®M¼Hô'."\r".'™ğKq$xçØ=¡ótJcF9L')."\x42\x2\x2f\xc5\x42\x9\x12\xb7\x76\xca\x42\x2c\x67\xa2\xa8\x31\x26\xcd\xe5\x34\x46\xbd\x64\x57\x51\x16\x8c\x93\x54\x59\xd4\x87\xd7\x82\x26\x44\xb8\x70\x8b\xd9\x43\x28\x6d\xd8\x18\x82\xe7\x9b\xc9\xce\x81\x4"."\242\130\41\335\231\105\134\146\331\144\345\251\30\173\261\163\360\314\166\140\72\245\5\0\316\41\113\272\117\10\67\325\315\222\122\146\21\10\102\62\325\313\233\43\272\4\304\347\156\105\221\42"."\x45\x69\xb2\x94\x24\xa\x95\xb0\xf8\x18\x91\x1a\xa1\xe9\x95\x26\x22\xb1\xe8\x5\x82\xb\x79\xc9\x7e\x9a\xce\x60\x1f\xde\x41\xf8\x44\x2f\x87\xdb\x2\xa5\x12\xa3\x5f\xda\x4c\x7c\x26\x8c\x80\x32\x8\xb3\xbf\x4".base64_decode('m3zVlitaeGhEGOLRovCHfXT244PHGDvkl8OVqLJSsXpBCXH47oxVRw/kcsJcyh2fNgud9Q==')."\162\46\31\62\155\266\166\262\231\145\226\6\325\140\174\33\63\275\150\356\76\0\167\162\352\351\105\26\66\67\335\73\16\76\214\325\343\150\161\16\146\215\202\316\124\56\3\106\311\252\306\262"."\376\77\313\306\225\75\217\147\310\164\344\202\323\44\365\63\66\10\36\321\345\75\3\127\265\12\26\305\127\155\50\116\310\42\40\17\110\21\325\166\210\124\161\122\276\64\235\34\24\202\246\57".base64_decode('7Q+8YoVjPmsamnXjcdsSwhPH+EIrZ8JJeCzlQoUI9yn4vHAhzsl4iHZxwnR1Zcm8lK0vvw==').base64_decode('99KzP6Lha5+a3P7urUCOKb2ctWCdBnPTjZ/fuD/6j4SFcfiZaw3zmMeO/vdvPjqs9oIDQg==')."\7\33\247\335\375\370\377\362\105\376\276\275\356\224\7\146\177\230\175\340\250\277\376\372\342\271\277\376\253\47\223\11\305\337\373\332\15\371\327\66\166\134\164\275\257\353\153\336\123\157\70\340"."\xd4\xef\x6f\x3b\xee\xfb\xa1\x2d\xb3\xf6\x3c\x74\xcb\x5\x1f\x6d\xfd\xf5\x5f\x8f\xdd\xb5\xea\xd4\x5b\x94\x6c\xe6\x95\xf1\xcc\x54\xcb\xb5\xff\x38\xea\xa6\xef\x7d\xf4\xc7\x27\x7a\x62\xaf\x7c\x7d\xe6\xb2\xfd\x6f".base64_decode('/uIPlr+bnTiwM6KojX98c1bPL69+pObx4oziy9fu+9tdWz+66LKjbp397/uOSD3/yNgvVg==')."\x5e\xba\xf6\x86\xaf\xcc\xda\x78\xf1\x4e\xdf\xc1\x91\x39\x5f\x3b\x3d\xd6\x78\xd1\x63\x4f\x4\xf\xd9\xd0\xf9\xb9\x7c\x44\x9b\xff\xc8\x4f\x5f\xfc\xdf\xb7\x96\xf\x1d\xfa\x78\xf3\xc8\xf3\x43\xc5\x5f\xe4\x9f\x6c"."\xfc\xe3\xb2\xb7\x2e\x78\xf9\xa5\x2d\x7f\xab\xbb\x64\xce\xe6\xdf\xaf\x5b\xf2\xde\xdf\x7e\x70\xdf\xbd\x87\x2e\x9a\x75\xd5\xb7\xe\x79\xb1\x7b\xf9\x9e\x43\x3f\xb8\xaf\xf7\xdc\x2f\x6c\x1b\xd9\x7a\xe1\xe8\xd5\x6f".base64_decode('vVVKbL1k46EXv3vLARnjzfiXlp7WeuuffnXfO8GWS15qOv+oFb/41cJN6nPX7R5++5bUxQ==').base64_decode('T912iPWT64++b/Dqb119+co3vhr/y19qH3/191vbjz/kkZ88c8jnvtSx84XfdX3jzy3D9w==')."\x34\xfe\xfc\x9b\x77\x6d\x3f\x53\x79\xe8\xde\xd9\x76\xef\xd8\x91\x2f\xbe\xd5\x75\x5a\xf4\xef\xad\x27\x7f\xe9\xf9\x86\xe5\x77\xb4\xc6\x76\x5b\x5f\x6c\xbd\xa1\xe9\xac\x7f\xde\xb8\xe5\xe0\x9f\x5f\xbf\xe1\xe1\x37".strrev('‡İğ·8k¹ÔÇ]Ög=jïùúV/¹¬öı¯¼›Ëí=ÃòÄãCTıŞo63»ô:›')."\xef\xa9\xf1\x3e\xfa\x83\x5d\xbf\x6f\xdf\x18\xfd\xe3\x39\x47\x9f\x7b\xe1\x75\x7\x7b\xe6\xaf\xdd\xd9\x7a\xc8\xfa\xe7\x2f\x9f\x77\x54\xf0\x96\x97\xcf\x99\xf9\xd8\x5b\x5a\xe4\x84\x33\xeb\x37\xdf\xf9\x56\xab\x71".strrev('{Ûÿhß»Æü>¿íñì}íïG5÷™¬õ;íÇ–úfuèÿ>÷Ìv\\ÏGõĞı<R£A')."\13\373\315\170\343\312\347\117\72\320\374\343\125\147\64\64\34\177\152\341\200\165\277\131\67\173\221\367\245\213\223\237\153\357\276\353\356\223\265\7\156\175\370\371\302\137\247\216\377\375\327\232"."\xcf\xbb\xf5\x1b\xb5\x6b\xe\xdb\xbf\xed\xea\x3\x9e\x3e\x6a\x86\xf6\xbb\xd2\x89\xe1\x5f\x6e\xbe\xeb\xe8\x1f\xf5\xde\x79\xfc\xbc\x8b\xae\xaf\x1f\x3e\xf2\xa6\x13\x1a\x8e\x28\x3d\x97\xbb\xc2\xf7\x8a\xfd\xab\xe8"."\366\153\136\271\247\153\336\245\307\55\56\136\271\355\326\313\277\170\126\335\346\77\377\354\251\257\174\175\361\266\45\373\371\237\76\364\310\323\132\336\74\342\270\367\257\213\52\175\67\275\73\363"."\340\143\357\277\377\67\311\3\137\77\373\362\225\137\156\376\161\351\117\207\67\276\166\310\360\177\106\346\246\276\164\364\52\145\323\21\17\356\373\334\161\217\36\373\223\266\334\57\22\347\324\154"."\x7c\x7f\xf3\x41\xff\xf5\xc8\xd5\x47\x5c\xd5\xfe\xd8\x5\xc6\xb6\x6f\xaf\xdf\x1e\x7f\xf2\xe8\xf7\x42\xbf\xff\xce\xcf\x56\x1e\x74\xd1\x87\x6b\x67\xed\x7c\xf8\xab\xb1\xcb\xbf\x30\xb7\xed\xdd\xfd\x62\xb3\xce\xa9"."\xb9\xf8\x86\xac\xd6\xfb\xb6\x76\xe5\xe7\xe6\x36\x1e\xdd\x70\x86\xea\xff\xea\x7f\x3d\x69\x1d\xb6\xf8\x81\x79\x8f\x1e\xb2\xf1\x9d\x3f\xa4\x4e\x1e\x1c\xbe\x6e\xf6\x8f\x17\xe7\xb7\x3c\xa2\x3c\xfe\xcc\x70\xe3\x7f"."\315\72\366\204\157\37\324\354\71\176\60\25\374\375\131\157\225\36\72\345\267\315\223\77\337\261\170\306\341\27\256\273\161\352\232\23\247\276\362\373\137\36\364\117\337\337\36\235\373\355\3\73"."\x22\x33\x97\x1f\x35\x77\xf9\xfa\xa3\xe6\xc\x35\xfc\x34\xb1\xea\xec\xcf\xaf\x9a\xcc\x46\x7f\x53\x77\x43\x36\x79\xfa\x4f\x7a\x5b\xb2\xf7\xdc\x53\xfa\xd1\xb\xcb\x9f\xfd\x7a\x3e\xba\x74\x47\x7e\xe8\xc1\x91\xd".strrev('Ï»7úüOˆÓ_ÏÆù´¾k3ËrOÓı¼ú°(aôÙ]ó¯[ká|}Swº/#¹ı±XyŞöw')."\x7b\xe2\x67\x87\x3c\x7a\xf0\x63\x47\x7a\x56\x1c\xf1\xcb\x2f\x99\x37\xbd\xd6\xfb\xf1\xe5\xa5\x17\xe\x7b\x7a\xf6\xaf\xf2\xc7\x2c\x35\x8e\xdb\xf5\xa5\x67\x37\x9c\x6f\x7c\xbd\xb1\xfd\xb1\x2f\xc5\xce\xff\x4b\xcf"."\x9\x3d\x97\xfe\x24\xf6\x85\x8f\x7e\xd9\x1e\x1c\xbe\xc3\x73\xd7\xda\xeb\x4f\x7a\xa8\x70\xc3\xd6\xcc\xf6\x9c\x7f\xc7\xba\xe3\x52\xc7\x7c\xe1\xa6\x7d\x57\xeb\xc7\xc4\xef\x3c\xf4\x6b\xff\xb1\xfd\xc1\x7d\xda\xb9"."\163\136\370\345\335\357\174\274\352\231\67\236\231\261\354\261\206\257\233\275\73\377\376\332\337\3\337\157\132\267\70\367\304\75\167\334\272\72\360\101\163\153\307\235\366\347\17\337\362\304\113\257".base64_decode('FV9tSr9YPKHv+RufMI/8ov67JfeWHo5NvvPxSPfSH773zx/6T/jNt9teuW/pUfY9p91+2g==').base64_decode('G89MtG5pLB571QnH3P7v0888f/UL3vtOvXfg2PjG2859uLU7fcJtn7f3O7Fr5l/z61/ZdQ==')."\xd5\xd3\x7b\xf\xfc\x57\xeb\x65\xdb\x1e\xbb\xef\xfd\x83\xbb\x16\x44\x1f\xbd\xa4\x78\x57\xd7\x49\xd7\xe7\x76\x84\x5e\x7b\xf5\x3f\x77\xf\x2f\x18\x7f\xee\xfe\xaf\xfe\xc1\xba\x62\xd1\xfc\xa7\xfe\x78\xfd\x2\xb3".base64_decode('5oNn1963318fTe9Zf5WybdmuOrXh1Qcf2f2Pwl/al695vld9aWz0rZfrMifF9czNrwTP9w==')."\175\363\275\67\137\273\160\305\103\23\357\75\167\353\163\61\377\47\37\275\273\153\267\177\307\151\17\175\363\223\277\274\267\146\267\377\223\341\177\377\166\353\326\247\77\51\175\370\366\63\223\373"."\276\165\327\303\265\37\375\343\234\157\174\364\247\13\317\176\375\375\330\153\357\377\256\346\351\23\223\21\45\372\307\23\336\72\351\227\305\345\267\34\360\263\216\201\203\132\366\264\350\201\113\216".base64_decode('W9/14v4bD7z/2fOD+78b3u/Be/+2fTD90E0vretZ+OjDzWc88WjvyXeePzWr4YCvnXfETw==').base64_decode('DjjkUP3DrvrYdXuu1aLfuOmVnpfGHhge6pt77ujlV/lfP/6O/G379j3zr2cuNq6Z9eTWqQ==')."\x17\xae\x5d\x78\xb9\xf6\xc4\x29\x17\x9f\xb6\xe3\xac\x53\x7e\x93\x38\xff\xa2\x35\x7\x75\x4f\xee\xbf\xf7\xc2\xb1\xcf\x1f\x76\x75\xfb\xe9\xcb\x2e\x3b\xfc\xd4\x1b\xe3\x77\xcf\xb8\xeb\xfd\x25\x2d\xe9\x81\x77\x43"."\336\303\267\324\34\146\237\230\313\44\57\135\154\76\177\301\215\233\265\7\136\170\352\312\367\67\75\367\310\267\117\174\157\313\105\257\176\330\270\360\236\263\75\173\117\177\370\245\160\335\261\346"."\77\274\167\150\53\37\323\347\275\271\373\223\336\77\274\175\306\45\241\342\326\115\147\336\176\376\117\157\176\361\167\67\34\321\364\364\300\77\73\277\265\370\167\117\174\134\172\113\333\264\163\315"."\311\77\377\360\205\341\127\367\255\276\377\235\217\106\66\354\313\335\272\376\320\37\74\22\370\121\337\336\147\347\335\170\301\41\363\336\375\340\233\13\365\130\346\35\303\374\301\302\337\374\341\324".base64_decode('B89bPzhR++c33yr89d3Ii2+8veG8RYuefe7kZ+6ve//SGTfcPX/55Z0zls784TlvXvVk7Q==')."\155\175\327\337\146\106\16\70\370\321\13\13\167\36\373\213\143\17\330\62\261\351\137\373\137\363\271\130\355\345\253\364\311\221\167\327\153\37\267\234\342\177\144\170\337\73\27\156\237\65\166\316".base64_decode('/v4dJ6z+8KYF7ccfcGP8q9u/e9d9By3Zr+3ha584ddOz2w/bOKPtZwd/PPbYK79ITkZeOg==')."\346\255\73\137\236\247\34\235\363\67\36\372\347\267\27\317\31\172\174\277\302\222\257\216\315\313\76\345\375\301\233\117\36\265\150\355\175\107\77\125\67\322\376\205\354\223\363\317\172\157\371\206"."\x9b\xf6\xf4\x9f\x72\xe8\xf7\x3a\x7f\xbe\x61\xe5\xb1\x93\x13\xf9\xdf\x25\x2f\xfe\x53\xf1\xf\x23\xdb\x27\x3d\x67\x9a\x1f\x3d\xf4\xf5\xf0\xa9\x77\xc7\xe\xba\xe1\x76\x75\xe8\xc9\x65\xbf\x3a\xea\xeb\x85\xa3\xe".strrev('ûÜ?óÒv>ç÷ãx^›ÉÚõ§±ÿ¶„qÓ_>›¸ï:/<iÎ»5Ä~ÜWÅ¹ÓërÇ'."\r".'ÑvÚ').strrev('Ç£/í¸®üºßÆÏ%©yªü>_Æú¾kï\\û?Ÿö^Gİğş›ÿb·Î²]ÏÅúËíC')."\16\246\337\377\372\217\276\270\364\252\37\371\274\55\357\176\174\310\362\346\27\217\157\171\174\347\167\24\63\177\334\133\157\135\266\64\61\177\256\166\373\263\73\142\175\371\7\32\326\235\371\235"."\221\373\316\377\327\257\57\130\262\342\210\365\207\136\364\75\377\233\177\135\363\306\115\257\375\363\321\77\77\166\375\315\336\315\257\274\263\375\355\315\272\157\376\327\132\357\156\75\247\174\245\176"."\xf4\x7\x1f\xbd\x74\xf9\x8c\xb7\xcd\xb3\xbf\xb5\x70\xde\x41\x6f\x66\x26\x1f\xa8\xbd\xe2\x91\x7\xbe\x77\xe0\x95\x3b\xfe\x30\xbb\xf9\x8f\x3b\xf6\xac\xb8\x7f\xfc\xb2\xdc\xfe\xd7\x29\x3f\x7d\x6d\xe6\x35\x89\x7f".strrev('>§¿Åzé7¿oÕõºŞoïó|ŸÓÅs›nëğö¢|ö›etÖßÏÅÊñß^Ní¯÷½W•ü¼')."\132\361\320\222\117\136\377\335\223\261\153\373\76\372\323\367\136\175\360\203\67\77\172\341\212\300\127\36\232\370\347\107\157\253\257\176\341\241\127\377\275\367\355\147\236\174\362\351\345\315\237\274"."\267\357\327\53\76\376\340\355\357\74\324\367\361\277\336\371\344\233\37\37\340\177\343\372\253\277\365\263\27\257\72\176\377\107\267\274\267\341\370\203\347\114\155\333\265\350\225\77\15\355\333\250".base64_decode('5H7ad8uzf1m6a9uDH08Fbn157/v/POO/bvjzvw49fst1hZOs+T+Onvj4yJ1LZx//HqK6Rw==')."\326\235\370\235\47\277\266\160\137\356\77\127\335\262\153\305\221\127\317\120\317\75\362\127\53\216\70\260\157\163\346\303\300\121\261\371\227\34\260\165\340\326\17\16\277\370\313\336\243\217\371\142"."\xf3\xba\xc7\xbf\x7c\xe0\x77\x6f\xee\x3f\xa6\xe1\xa8\x4f\xe\xfd\xce\x6f\x9f\xff\xed\xdb\x47\xb2\x9b\x6d\x4b\x98\x21\x18\xe8\x6e\x87\xcb\xe3\x25\x33\xb\x4a\xbc\xc6\x5\x4b\x68\x0\xc\xa2\x16\x2c\x0\xac\xc6"."\106\260\43\132\62\37\324\151\363\27\321\337\134\151\274\70\121\146\371\351\317\242\305\220\230\261\323\146\276\70\1\122\330\42\50\165\36\63\112\152\134\4\237\263\354\1\255\137\207\155\44\377"."\0\210\155\203\126\146\140\104\7\325\304\102\126\43\143\64\77\142\347\262\254\336\260\51\31\56\215\14\331\354\204\331\50\14\333\23\151\126\32\234\43\57\201\374\271\362\240\135\140\67\53\354"."\301\221\302\100\36\76\301\276\260\144\36\230\170\216\144\123\272\151\161\235\317\160\141\154\20\316\346\346\55\204\72\66\55\204\26\17\344\163\375\245\101\120\363\232\303\3\371\176\3\104\363\371".base64_decode('rDjWLqs0njXzYJSsDxq5sRII99kJPVMcAIVcYaKUy9uDUPx4YXB4gh3Gl/WxrAUNHE5p5Q==').base64_decode('8cEsqxd8a3xsaMIahW8saADo/Abor2FrfGDMhg81NUHF8sWBoUEdVKND9thIdnyYNT7dnw==')."\xcf\xc0\x69\xf2\xa2\x6\xc0\xcf\x8c\xe6\x6\xf3\x3a\x7c\x7a\xb8\x7f\x68\x30\xad\x41\x91\xf3\x59\x6f\x6b\x68\x9b\x92\xeb\x7\x81\x7e\xc1\x12\xa8\xc7\x92\x25\x50\x82\x9e\x2e\x8c\xc\xe6\xa0\x59\xf3\x80\x4c\x16"."\316\203\132\56\230\17\164\305\210\160\330\260\306\112\332\40\153\14\224\61\121\56\151\103\260\371\324\262\351\102\151\30\266\132\105\275\60\66\64\0\332\332\264\75\76\221\55\103\173\26\65\1"."\125\114\364\217\225\206\262\200\202\220\321\366\1\232\220\65\122\203\143\245\121\106\302\200\237\263\13\103\145\13\372\165\320\66\207\306\307\162\254\311\214\44\26\100\255\347\63\42\31\30\37\66"."\x6d\x76\x30\xbe\x64\x3e\x74\xcd\x68\x46\xcf\x8e\x95\x80\xa0\x52\x85\xf2\x40\x9a\x69\x9\x32\xa3\x5a\x76\x24\x7\xb4\x34\xa6\xdb\xa5\x9\xb6\xcd\x6b\x64\x5d\xd3\x3f\x96\x9a\xc8\x33\xfb\xf2\xc6\x79\x30\x9d\xf2".strrev('çaF÷'."\r".'`ä=f,s¬ÃcÛOBrÔo8b‘¸Ì‰èè~íM˜9…0½#)@Ê]‚é')."\x3a\xa8\x59\x63\x99\x9\x18\xf8\x26\x36\x6e\xf3\x17\xb2\x1\x9c\xf\xf5\x59\xc4\xd8\x8a\x9d\xea\x1f\x1f\x60\xcc\x66\x71\x3\xc\xe7\xe2\x79\x50\x78\x39\x5b\x18\x1e\x4d\xc1\x28\xcc\x6b\x82\xfe\xcb\x8e\x67\xb4"."\222\11\320\106\66\142\213\26\102\27\54\154\200\251\267\230\315\301\162\141\154\304\116\3\225\316\153\144\23\237\125\213\61\47\333\34\54\131\231\121\226\12\165\30\37\30\234\310\233\320\351\113".base64_decode('FgHu+JCWsQcBN1+0h8xx0KrbQ8Oj/QN51iT4WCpTKBlstBY0sZm/EFrcqqWGmAKYG+3K1g==')."\256\324\156\213\152\332\344\23\23\166\3\322\50\370\362\132\201\333\314\164\100\143\145\330\220\256\63\273\371\176\326\140\156\207\1\206\266\0\67\362\272\120\152\323\243\3\226\123\354\322\261\212".strrev('tÔ£´å™Ê3!±è%še®E‚9U8¶yuêÜŸC\\:Ğı¦ÈMHæ(ÉK`ªJ\\„ÑÀä²D')."\xbf\xaf\x4a\x4f\xd2\x96\x54\x4b\x19\x70\xc3\xb9\xbd\x8f\x28\xd0\x61\xc2\xce\x60\x8e\x5e\xeb\x27\x23\xca\x8d\x8b\xf0\x1f\xa8\x37\xbd\xcb\x6b\x61\x63\x6c\x7e\xf5\x8c\x62\xfb\xd8\xc0\xf4\x4b\xe4\x40\x75\xf2\xb6"."\146\15\371\144\260\127\116\65\12\250\276\271\234\317\171\273\33\137\263\356\356\122\223\201\304\52\311\150\17\137\3\146\264\243\212\373\11\122\73\304\240\111\75\50\217\235\263\315\214\66\366\334"."\261\153\362\302\313\247\56\273\163\152\333\216\311\373\57\331\263\343\316\311\7\57\103\321\327\167\136\60\271\343\332\275\127\235\371\372\316\155\257\357\74\175\317\331\367\354\173\340\374\311\13\357"."\330\163\306\203\223\327\334\74\171\343\331\257\357\172\160\317\103\147\357\276\171\353\353\73\157\237\272\346\334\311\63\177\374\372\256\313\47\317\371\376\344\331\27\116\135\262\355\365\7\257\101\370"."\x53\xe7\x88\x92\x11\xda\xe4\xed\x57\xe2\xbc\xf\x6c\x99\xdc\xb9\x73\xcf\x75\x37\xf3\xd4\x7d\xf\x6c\xa6\x95\x61\x4c\x68\xa5\x6e\x2b\x89\x53\x22\xcc\x12\x8b\x10\xa4\xb2\x5c\x1\x52\xd4\x2d\x9f\xd2\x95\xd3\x51"."\217\51\51\174\347\11\233\155\331\131\275\244\330\304\174\113\103\177\13\146\301\113\111\215\336\114\267\24\243\200\223\25\326\327\76\116\216\111\75\137\304\104\5\275\344\247\127\124\35\27\41\44"."\312\253\326\315\64\241\12\35\341\276\26\143\125\207\203\160\22\207\365\175\312\200\206\0\351\146\145\0\145\123\330\105\54\305\66\131\70\77\316\7\335\105\376\125\207\225\127\203\15\155\206\253".strrev('FsË¬€'."\n".'ØØûÎ+œ…*´(ğ±-u'."\0".'ÎIÈ“šf8““æE$-G¡pİ&*6…İ')."\xae\x7e\x49\x2f\xe6\xf8\xa1\x11\xd6\x78\x56\xed\x44\x57\x13\x12\x55\xba\x8b\x37\xc2\x91\x88\xe6\x63\xd9\xae\x82\x28\xf7\xaa\xac\x6\x36\xcc\x60\xe\xb1\x32\x71\x88\xa9\x6a\x3\x70\x1b\x34\x5c\x70\x43\x44\x4b"."\325\214\156\63\303\177\213\315\372\104\70\250\166\5\230\251\272\126\54\372\255\364\220\345\307\366\144\306\210\36\61\372\375\370\176\65\246\137\37\277\201\114\310\137\325\372\315\222\315\116\10\312"."\370\176\356\220\374\155\100\305\226\4\242\43\151\124\50\306\121\27\160\36\135\322\323\6\263\164\326\363\4\23\12\367\111\307\122\364\72\25\67\267\116\241\11\131\162\234\270\55\133\121\314\26"."\xb1\xdb\xd\x7b\xe9\xa\xb0\xfb\x67\xf7\xea\xa4\x3a\x40\x58\x5c\xf\x93\xa1\x39\xf7\x29\x1e\x9f\xbe\x6d\xad\x92\xf3\xb\x8c\xd6\xec\xf5\x7a\x25\x6d\xb3\x30\x77\xc3\x21\x28\x4e\x1c\x66\x23\x58\x8\xf3\x96\xe9"."\340\155\334\306\3\61\235\114\106\267\354\146\162\313\126\231\253\240\212\56\366\65\242\0\231\236\13\174\213\120\220\364\30\260\224\136\350\305\262\305\356\74\315\366\315\7\351\314\132\12\6\52".base64_decode('Swlna5GqD3CRCw0kg6IgQomXC5gOm51t1gtpKdNSLWVLpaoD0Kk+0R/aXJGup2fCwEi9NA==').base64_decode('Cggsb6eTBlD7vZws0PAiIk5bxFgW1jMo0pKcEsQFReHspLs+JastD3kRTZQCt5K1cho7DQ==')."\265\360\355\235\202\316\351\257\154\361\3\33\154\121\256\42\231\302\22\264\252\246\15\110\214\204\133\325\266\60\330\121\6\272\302\152\42\21\223\146\36\271\314\274\126\135\25\153\123\203\261\330"."\xaa\x30\xd0\x18\xf4\x6a\xb3\xc4\x94\xf1\x1d\x4a\x71\xc6\x8d\x63\xe2\x2e\x25\x3e\x17\x92\x8d\xda\x64\x79\x7\xbb\xe7\xc0\x2b\x7b\x42\x1\xe3\x4f\x44\xcc\xc1\x8e\x40\x9c\x9b\xdc\x2f\xf0\x35\xf8\x1a\x5\x2e\xfa"."\240\212\257\34\264\260\373\376\211\144\40\136\305\111\13\165\336\2\75\16\16\133\40\103\107\154\215\22\214\105\272\73\243\11\352\233\204\302\243\61\51\235\30\126\103\62\163\341\122\231\14\305"."\x87\xba\x22\x81\x60\x48\x9\x47\x93\x31\x76\x65\x82\xdb\xb6\x92\xcb\x32\x9\x1e\x67\x5d\x50\xb2\x74\xee\xa2\x5\xf2\xd3\x88\x7c\xa1\x47\x2e\x91\x97\x4\x34\xda\xe3\xa9\xed\xad\xe9\x9d\xd3\x5b\xd7\x5b\xbf\xde"."\xd7\x6b\xf5\x1\x37\x21\x23\x62\xc8\xc3\x3\x91\xae\x36\x68\x5e\x33\xf\xa5\x2d\x98\x9d\x9d\x9\x24\x5f\xd0\x60\x2c\x1e\x8\x46\x58\x55\x10\x1f\x86\x60\x2c\x18\xa6\x81\xdd\x97\xde\xf5\xfa\xfd\x17\xec\xfe\xce"."\216\311\163\267\241\202\246\256\336\62\165\305\217\221\124\204\45\241\35\347\357\376\351\5\123\227\336\61\165\376\146\250\377\236\73\356\173\375\301\207\166\137\172\363\344\216\53\247\56\377\311\356"."\253\277\115\23\366\336\162\327\344\171\67\363\212\51\173\57\371\351\324\5\67\161\351\210\12\105\36\224\173\357\231\333\166\77\270\3\313\106\67\234\76\165\357\326\251\153\266\115\236\167\335\344"."\x55\x37\xef\xbe\xe0\x8e\xc9\xeb\xcf\x98\x3c\x6b\xdb\x9e\x3b\x2e\x9b\xe9\x26\x24\x1a\xef\x61\x43\x1\xd7\xb8\xfd\xa7\xe1\x2b\xf8\xb4\x7b\x7b\xad\xb9\xb8\x6b\xeb\xd1\x6f\x1d\xbe\x88\x81\x7e\x99\x3d\x39\xb1\x31"."\76\245\73\24\15\206\334\67\232\344\50\370\267\231\103\51\204\332\333\200\70\154\201\177\34\26\47\276\60\132\152\247\255\305\106\30\177\251\122\122\145\332\102\211\140\74\334\32\2\123\177\76".base64_decode('ULOJKAfWFgiaiK/mYX4FtsIfkVLHiLlecTRE86XMXDlfIJVVarDxV40HLzDkepVSgxdLBA==').strrev('Ú¢¿D½@Õ)©^¡§£Xı<GÇ>yÎ,¥"‹€sDVpëx4õ«®×'."\n".'˜„©ì:ıÅñĞ').base64_decode('qxTTUjRPHVRYrq7ARezRskuagUQJJeXhIJ4f/TrcDqV8IgcdJ4ThhimBaJsTk3or6qollg==')."\232\51\237\315\135\236\260\141\256\255\127\372\341\2\105\225\104\222\315\321\31\55\216\316\250\233\13\174\242\153\45\37\157\172\73\102\241\267\346\150\265\64\213\15\24\100\311\120\141\50\35\55"."\206\153\242\146\240\301\241\370\50\300\123\360\75\2\136\22\142\107\74\201\215\40\206\363\101\254\222\106\334\110\325\120\161\223\266\63\157\145\30\253\203\353\371\235\353\170\33\30\55\303\20\350"."\xc2\x9\x15\xbe\xff\x17\x4a\x6\x3b\x28\x95\x27\x24\x32\x4f\xf7\xcf\x76\x10\xaa\xe8\x4e\xc5\x41\x22\x7c\xcf\x2\x78\x74\xba\x60\x86\x70\x10\xc1\xb\x47\xdb\x63\xf1\x4e\x7a\xef\x2d\x11\xec\x8\x75\x6\x7c\xc0"."\304\51\45\120\174\54\106\51\55\112\55\346\174\24\124\353\350\176\362\41\326\145\111\362\125\64\257\124\33\311\104\264\27\212\31\250\14\214\276\102\374\14\150\44\113\113\55\165\5\3\105\162".base64_decode('b2mxeFJFHQDsWeK6tdJqIZmV41tcI2yzMYCEHJM5tUn3M6dqqHBcZjAWbQ+zK35tsDUvpg==')."\115\7\122\133\74\214\75\175\300\367\25\126\224\164\261\22\105\204\155\7\212\24\107\323\74\54\234\47\340\4\276\346\243\210\130\362\121\204\57\66\30\113\362\376\206\277\237\210\362\260\220\143"."\x51\xa4\x3b\xc1\x6e\x78\x60\xee\xbb\xa6\x8d\x87\x3b\xf8\x3d\x77\x9c\x10\x8b\x4b\x91\x40\x3c\xd0\x99\xe0\xd1\xf8\x1a\x7e\x63\x84\xc3\xe8\xcd\x11\x35\xda\xdd\x29\x38\x7e\x24\xb0\x1a\x11\x4b\x8c\xf5\x37\xdb\x2".base64_decode('+U+r881ZUd9LL+PRIP05icXwBaW+DY0eZeGmesDhHjPsLNp9qOIrp0TUSGwljROvdKFCWg==')."\154\73\224\36\5\111\265\111\41\325\132\154\351\342\263\101\101\64\254\320\253\275\112\64\266\46\40\34\235\111\11\0\21\176\317\374\247\365\364\216\366\372\220\260\140\255\27\227\353\332\132\25"."\46\206\20\147\51\240\137\200\334\1\266\214\256\367\300\212\241\346\314\14\163\143\204\30\42\15\304\140\174\326\262\0\341\225\220\41\105\256\75\217\361\112\4\274\247\252\275\33\173\117\354\365"."\xfa\xe8\x8d\x46\x2c\xbc\xf4\x7a\x44\x95\xd4\xd0\x5a\xb4\xc6\x26\x12\x8e\xeb\x98\x2a\x71\xd8\x5\xa5\xa3\x56\x42\x88\xce\x5a\x1a\x59\x6\x3f\xb0\xb1\x5a\x6\xe2\x29\x44\x97\xb7\xf0\xc1\xc\x9d\xb2\x31\x8a\xfe"."\256\114\156\14\241\277\21\364\23\111\242\341\62\70\2\232\222\221\360\252\320\106\374\217\110\250\347\35\111\57\56\71\63\204\243\33\321\277\210\301\154\14\107\335\205\265\206\222\153\102\41\212"."\300\302\360\53\120\21\303\201\246\112\136\13\361\55\2\110\26\267\12\240\150\125\255\43\235\351\355\233\133\257\252\176\253\33\350\205\273\4\251\253\235\325\130\13\153\110\40\21\204\1\17\261".base64_decode('EBBEJS0Qm38nIXBffBBfGY91d0nxjsDqcHQli/nnsNAcKFppCydQFwUZMQoXgXKchqlYJA==')."\113\275\16\222\156\103\234\35\105\44\221\35\157\6\50\147\166\316\262\326\356\160\244\115\276\172\216\21\151\150\66\341\352\260\246\314\146\225\143\161\162\11\235\105\160\227\263\60\41\67\26\41"."\x7d\xc0\x22\xb4\x3\x58\x8c\x74\x17\x8b\x10\x57\x84\x2c\x42\x1a\xca\x22\x78\x77\x12\x8a\xb2\x34\xb4\x1\x44\x9b\x37\xb6\xab\xcb\x6a\x23\xfc\xa\xe5\xd2\x74\xbf\xe4\x2f\x4\xf3\x60\x1f\x55\xc9\x61\xaf\x31\x68"."\307\250\161\365\253\113\213\112\24\140\322\256\236\332\1\52\322\25\156\254\216\225\224\126\176\212\201\204\117\202\203\176\173\327\257\40\302\361\172\106\247\364\366\260\235\64\354\234\343\243\160\313"."\20\175\64\114\256\166\112\237\325\240\373\211\366\121\65\45\335\67\131\267\145\200\320\167\121\105\71\250\212\205\72\11\233\103\22\45\62\215\72\167\124\234\115\255\347\33\45\160\277\340\201\137"."\xa8\xd1\xc1\xf4\xa7\x17\xa2\x4c\x41\xd1\xb\x1f\xa9\xf5\xc0\xa2\xdb\xcb\x4\xf6\x9e\xde\xb1\x86\x6\x2f\xfa\x67\x31\xfa\xdb\x8a\xfe\x6\xd1\xdf\x10\x6\xb4\xf7\x8e\x2d\x6a\x47\x81\x25\xed\x7d\x7e\x38\x67\x65"."\xb7\x38\x9c\xfa\xac\xde\xde\x9a\xe9\x3a\x19\x10\x58\x57\x43\xb4\x86\x46\x59\x2e\xe8\x7f\xb4\x72\xa6\xb2\xd8\x8d\x8d\x6a\xe7\x99\x5a\x9e\x6c\xf1\x84\x3e\x9c\x6a\xe6\x45\xbc\x2d\x1e\xeb\xa2\x72\x8c\x12\x6e\x57".base64_decode('qE8HpZbq8mtBQAvGQ3iOUSyWVlfr0Fgtr1Xgnne9M1c42hZaq9Qa6TFV01TIrKAZzQpSKg==')."\x4a\x62\x25\xd0\xba\xb2\x83\xe3\xac\x39\xaa\xc8\x44\xca\x76\xdd\x41\xa\x4b\xa\xc2\xad\x10\xf0\x88\x77\x6\x76\xa7\xd6\x3\x5b\x7b\x9e\x42\xe5\x6a\x9a\x14\x4e\xa0\x65\x3f\x12\x21\x2d\x45\x49\x86\x85\xc5\x61"."\217\302\235\50\140\40\336\302\120\275\54\24\304\22\150\101\64\51\264\66\31\17\140\40\221\141\147\34\204\376\20\266\204\367\130\245\274\106\57\232\22\311\317\267\36\124\15\353\35\202\46\25"."\101\261\250\11\164\107\26\116\251\115\74\205\350\33\150\67\313\332\210\125\40\273\323\130\127\74\334\31\210\257\203\56\23\73\11\230\270\146\316\161\335\130\104\14\253\133\272\360\36\105\265\226"."\x2f\xc0\xd3\x31\x86\xd9\x17\xd\xa3\x5d\x31\xd\x93\xda\xd0\x60\xd\x1e\x79\x1a\x4\xff\xb3\x2a\xbf\xcf\xcc\x54\x31\x75\xec\x5e\xb0\x87\x5\x98\x43\x9\x72\xd7\x8a\x29\xb3\xf2\x88\x71\xf1\x98\x18\x35\xa0\x7d"."\30\25\71\125\276\55\46\34\344\342\245\26\17\62\114\200\120\173\240\73\42\103\240\253\224\125\241\165\237\62\107\130\115\253\315\21\226\306\224\72\174\266\101\173\352\26\100\373\250\253\213\272"."\46\264\263\55\27\260\123\34\356\203\23\152\105\143\201\356\144\114\105\253\120\74\204\327\4\150\21\357\126\251\276\322\356\135\36\24\50\6\43\160\157\303\237\322\64\206\123\255\151\74\77\327"."\x5f\x85\xa2\x2b\xc3\xd1\x50\x4b\xe7\x78\x38\x11\xe8\x54\x58\xc5\x41\x43\x87\x3d\x6f\x2e\x86\x72\xc2\x31\x35\x82\x24\x6b\x55\x56\xc2\x85\x63\xa0\x7\x76\xb8\x75\x54\x55\xe1\x27\xc5\xa7\x9\xcb\x72\xbb\x54\x96"."\x9c\xe4\x19\x26\xb1\xe2\xee\xe4\x17\x3e\x88\xd9\x39\x22\x88\x80\x70\x93\xc0\x75\xd5\x24\xad\xdc\x8f\x73\xcb\x8b\x1e\xe4\x77\x79\x4f\x35\xcc\x66\x9c\x82\x91\xa9\xac\xb3\x54\xa0\xab\x8e\x8f\xbb\xcd\xb6\x65\xb0"."\260\50\27\307\314\354\44\233\73\331\203\14\335\222\233\3\234\131\141\37\44\307\115\5\147\365\320\62\233\143\216\256\124\135\264\46\257\133\26\77\156\116\146\165\305\52\352\51\342\256\123\1".base64_decode('J3NK2tQt4d8b+p7stljQzgqHELKf27ZW1snlgp3Qc6Cjb+snpvvikp241CSZ9JNDIDFy1A==').strrev(':'."\0".'¨3¬'."\r".'iÄk9Ç ŞRô»0Y+ÉJ}ĞE°a1ı3¦>Ì¢\'Å¶8D`	a#]æ”#+Ÿ{')."\376\76\305\225\117\356\165\174\70\131\201\211\35\137\174\332\30\62\37\147\244\146\322\15\113\34\5\132\301\47\255\322\275\225\162\1\175\304\53\337\204\102\264\103\200\322\335\13\346\352\220\306"."\x16\x81\x1\xc\xa2\x4f\x8\x64\x0\xc2\x7e\x4b\x2c\xc5\x27\x1c\xe5\x90\x32\xb1\x54\xe5\x15\x8e\x2b\xd2\x9a\x7c\xe9\x54\xf2\x10\x3f\x53\xa6\x14\x32\xe4\x82\xb6\x7\xc\xd9\x8b\x85\x4f\xf8\x6\xe6\xd3\xe5\x24".base64_decode('PlD4MjYc92OBfUCV6tLF8YVXUNob0jAQAA2SCa40i0p0GJj+xyXakaCdzKkTeCaOmCBa4w==')."\313\43\272\15\236\303\34\374\51\34\203\274\76\35\337\304\242\367\142\102\334\261\43\312\110\335\337\175\166\246\156\311\71\363\64\54\245\152\276\40\40\362\17\226\210\322\351\263\77\30\327\305"."\xaa\x8f\xb2\x91\x8b\x6f\x9f\x99\x49\xb0\x58\xf2\x25\x92\x49\x62\xcb\xae\x3c\x84\x1c\xe9\x25\x1d\x18\xf9\x2c\x24\xb\x1a\x43\x6b\x41\x34\xa6\x76\xa0\xe5\x26\xc6\x84\x12\xc3\x4a\x3a\xd8\x3b\xcb\x5\x2c\xc4\x46"."\62\123\312\117\256\21\303\306\161\51\71\317\245\307\230\60\330\33\20\347\346\41\146\214\2\76\302\204\60\20\240\77\353\362\151\57\252\70\120\135\132\267\271\213\46\314\5\331\365\113\134\147"."\351\22\166\236\63\330\121\311\33\253\66\242\343\173\156\114\55\123\141\307\3\115\251\154\34\124\21\37\237\45\142\335\161\166\306\203\343\130\267\245\306\103\301\165\374\270\205\103\333\3\253\335"."\220\60\326\115\6\126\126\5\163\215\31\206\223\255\251\32\217\141\325\142\50\322\356\312\220\350\340\236\174\235\60\65\22\216\256\252\232\200\104\223\116\51\13\5\206\223\241\116\67\314\131\102"."\42\24\210\63\67\323\70\336\32\211\5\245\344\160\254\262\47\270\354\303\201\124\61\111\201\376\323\352\172\67\220\135\121\63\332\34\245\67\142\15\206\127\355\233\133\277\242\167\123\175\135\257".strrev('Ou¸káı_„H¿0™ú÷ğğ|ûólÒëÀ'."\r".'Ù§Å±lò]%vQ¼Wo…')."\120\247\112\216\212\272\174\217\260\133\376\76\367\145\64\225\335\100\203\50\276\150\254\362\31\210\117\161\325\304\272\4\37\53\47\314\101\221\224\246\145\153\16\27\62\372\333\45\243\142\103\241"."\xaa\x88\xe\x92\x76\x5c\xae\x96\x41\x3e\xc3\x14\xb3\x45\x4c\xeb\xb4\x99\x2a\x63\x37\x4e\x62\x8c\xc4\x55\x6c\x4\xf2\x39\x8a\x40\xc\x7d\x48\x68\x7\x60\x56\x26\xd8\xec\x2d\xa0\xb5\x12\x16\xe3\x20\x92\x5a\x57"."\166\204\117\136\25\351\214\306\272\116\211\47\222\335\253\327\254\135\7\236\47\233\31\321\14\50\136\246\13\1\7\270\376\21\255\344\37\141\56\375\127\343\115\207\156\371\145\141\216\3\121\33"."\261\173\142\346\131\215\252\60\170\52\346\36\376\352\111\264\64\177\276\140\67\116\203\321\125\322\373\115\323\236\46\165\165\347\247\27\14\211\75\275\126\37\247\322\264\76\2\101\141\151\147\211"."\255\26\10\31\136\371\151\1\114\255\262\274\230\356\167\111\3\0\20\366\66\222\314\40\200\334\101\65\215\216\353\302\76\321\34\225\34\74\263\111\63\114\174\211\272\35\221\16\173\265\41\107"."\272\160\353\74\354\105\333\117\107\334\345\214\364\104\302\343\73\315\114\251\311\157\343\232\24\320\272\0\137\3\111\101\236\6\144\255\340\146\75\170\105\352\160\115\102\16\344\136\71\22\304\360"."\262\131\231\17\316\370\333\221\114\235\126\172\250\230\14\52\175\54\142\21\177\362\64\352\121\204\333\153\246\214\165\372\263\146\363\200\170\334\21\262\167\112\366\311\300\270\152\176\110\230\72\345"."\x87\xb8\xad\x47\xca\x21\x55\xe0\x5\x5c\xc4\x4a\x92\xe0\x0\xaf\x66\xa0\xb4\xd6\x71\x66\xa4\xb\x97\x54\x5b\xc7\xe3\xd2\x7b\x40\xe\x7f\x18\xf2\x3b\x23\x5a\xb1\x18\xcc\xe2\x36\x38\x26\xa7\x3\x94\x92\x23\x3"."\330\102\105\266\154\161\72\325\106\311\155\124\172\113\163\174\113\204\270\143\324\1\311\145\152\105\11\110\322\53\204\330\175\374\212\124\44\26\32\42\371\323\353\322\111\272\227\43\303\316\0\250"."\36\246\30\76\304\7\202\33\363\232\226\345\55\226\114\154\132\327\142\344\63\176\153\24\322\162\232\145\257\166\370\51\372\114\237\332\330\35\107\47\227\223\241\12\143\136\102\325\354\43\220\25"."\203\374\45\235\334\3\37\205\165\301\103\34\151\252\15\214\140\374\250\156\176\354\147\221\10\264\334\356\54\226\140\347\77\316\326\323\267\242\244\55\66\270\172\343\176\244\271\227\151\341\212\232"."\252\355\151\130\370\310\105\162\171\40\203\275\223\230\5\366\32\16\175\243\100\366\165\236\326\111\165\371\175\174\311\115\70\176\47\3\115\165\146\232\47\71\14\107\222\136\206\17\43\161\13\54"."\273\137\304\135\356\315\73\236\307\240\3\344\164\303\155\351\372\20\63\162\304\243\55\70\112\211\173\113\247\247\271\336\252\0\257\144\34\110\347\223\364\154\2\376\34\154\360\263\364\101\6\250"."\57\375\71\265\132\355\275\45\341\300\34\215\16\175\336\141\225\76\316\174\202\273\330\234\313\215\170\357\312\336\316\336\244\334\134\273\244\15\14\240\312\112\216\125\35\165\21\136\313\201\232\310"."\x53\x27\xac\xb\xa6\xf7\x79\xe\x47\x15\x27\x56\x75\x99\xe\x89\x71\xda\xf6\x20\xde\x56\x8d\xe1\x77\x28\x84\x67\xcf\xee\x78\xc4\x71\xfe\x4\xa8\xac\x95\x13\x59\x6f\x90\x19\x78\x99\xe5\x5c\x9a\x6c\x55\xd1\xa7".base64_decode('zBzapYuT6Kkrvj/1o8v2PHTt1AU3vb5z19Q191M47bU2vcDHfmrrxbt3fXfPjof2XrFj3w==').base64_decode('A+fvueM+bGn0vZuo4dHkhVumLrtz8sLz9tz77an7t09994y9V23/8+lbYPYUiIvRQClTFg==').base64_decode('/USzTH3/gckHLtx76VV77rhDwrexHVxOmj5oJCfPOnPvGTdPXnjR7ku/V5GBfsA91rh5lw==').base64_decode('nbP76m9LKe5MrcSdudif8zw0YXL7tt0/uNOdifrlr5Jp6vKzX9/1Y1emqJkop7Ktkt/0qQ==').base64_decode('88+e3HE1/8jrO7dRK3dXFm75xvFp+ZX4CUbVbaZuobW0U7NTMJF33/5TVB/aY/LITd5x1g==')."\356\357\157\336\175\373\271\60\22\127\336\61\271\375\177\115\335\176\303\356\353\166\360\142\201\252\34\326\264\270\200\273\266\354\371\361\231\123\127\374\230\43\342\151\237\126\4\16\241\50\212\203"."\x2d\xfa\xc9\x7\x77\x3f\x78\xd1\xee\x5d\xd7\x60\x22\x39\x6f\xcb\xee\x2d\x3f\x99\xbc\xe6\xce\xc9\xef\x9e\xce\x3f\x3b\xb9\x73\xa7\xe8\xe5\x98\x9f\xbc\x18\x56\x85\xe1\x9e\x82\xe1\xc0\x72\x7\x84\x29\x78\xb1\x2c".base64_decode('PVonMzksePGHxrAGij6hwOQp8toBPLfTwiYt6sdCq5mGvt9Qg9hnTXPNrDr0W1/jqcG7Cw==')."\x12\xc7\xc\x14\x3\x48\x3d\x6a\x9a\x67\xd5\x91\x40\x3d\x38\x47\x9a\x80\xb5\x43\x72\x93\x2c\x26\x1e\xe8\x65\x57\x20\xee\x21\x9d\x5b\xae\x20\x4b\x11\x5e\xe8\x9a\xfc\x4d\x7e\xb6\xf8\xad\x18\xc6\x5f\x14\x8f\x64".base64_decode('dfM1R7xCQFcf+roJO9yM6vaoWZJNlpsa5sscDHrLglWAOvYXSi0gPWpKuH1bJdFBhn5qFA==')."\354\100\277\357\356\311\63\177\264\367\212\333\335\270\124\153\302\254\316\221\210\126\361\312\42\275\6\62\171\321\225\225\337\43\370\316\257\61\344\311\315\327\354\276\324\205\311\354\147\25\111\75"."\46\62\20\352\167\361\21\276\66\310\131\50\275\377\117\146\21\125\126\66\143\265\75\5\254\365\166\27\307\313\5\57\126\137\171\23\262\33\115\327\103\101\15\116\174\254\200\162\342\313\62\103"."\x4a\xac\xbd\x79\x11\xa4\xf\x18\x35\x2b\xf2\xf3\x62\x92\x37\x70\xa2\xdc\xa4\x8b\x1b\xb3\x68\x2\x18\x16\x27\x18\x48\x88\x16\x3\xe2\xd2\xb\x96\x10\x54\xa7\x84\x70\x92\xab\xbe\xd8\x22\xc5\x8b\xc4\x7c\x3c\xc7".base64_decode('0MS1DelNBBnF+V6V+xUrdy+QLFgb6pVf0BpD+zCcjN9F8WLdqtdIT5ciGEfVqqbgHYJqKA==').strrev('%‚ó^i¥iòë#«åZÖv!Ü¿t"?/4ÊÀÖŸ“ËÌ"4‰w•UƒìË–ñ¼±$şí#eİ')."\xcd\xec\xee\xe5\x89\xcc\x70\xa8\x5c\x64\x96\xfe\x28\xc8\x5e\x25\x99\xe9\x1f\x60\xbc\x46\xbc\x3f\xc5\xda\x86\x7\x5c\x7a\xc6\xc5\x1\x16\xdd\xc8\x1f\x96\x60\x4c\xca\x81\x27\x6a\xeb\x78\x3d\xd\x1a\x4a\x15\x3b".base64_decode('0rsz5GCHsihsTqfy93mqcGu0RQcSZTdhpassfEAyLFDi+JqYIv25IdESwl+AwodQRU2xaw==').base64_decode('IvKqxBlS2XJhqEVKVGzTVPJaYXwmBc62mmdbS/GHWvB1Dms2e4pJ+JLGa5XwEkp9XEEKPQ==').base64_decode('xvLhJ9V8eCGMs5v2VAlMw12E5dMwPG4FCZHuleGoZAEoAdRgW1QNdHVVTZC/4cfmM75B6Q==')."\175\115\32\132\206\166\147\112\12\337\142\152\251\301\320\32\305\52\245\230\167\355\32\77\30\224\21\4\41\44\55\63\40\113\55\316\242\14\40\222\361\222\20\115\256\135\276\314\157\100\116\237"."\xff\x4\xcc\xc2\xfd\xd8\x94\xae\x70\x22\x1e\x50\xd9\xb2\x87\x40\xdb\x85\xcb\x30\x45\x59\xa6\x29\xb4\xeb\x5a\x6a\xc9\xb1\x49\xad\x92\x45\xcb\x3c\xb7\x23\x5e\xee\xce\xcc\xdf\x43\x5b\xe6\xd7\xe4\x44\x3c\x99\xe2"."\x26\xdb\x42\xf2\x6d\xfb\x8\xf7\x90\x59\xf5\xc4\x2c\x20\xb9\xdc\x27\x4f\x17\x5\xb5\xc2\xea\xca\x2c\xb8\x70\x5f\x4a\x4e\xea\xa1\x37\xd8\xfa\xe4\xe1\x23\x77\xc7\x2a\x73\xfb\x89\x82\xc8\x2f\xf4\x15\x2a\x7d\x37".base64_decode('tPp5Iz9mq0IY2CYG0TgzRtBSQ5jKxJIA1YCELqx9oAmOR0ZsybipjK9QkkObkniKbcMGWg==')."\20\176\174\146\323\246\112\30\230\113\273\223\2\105\303\15\302\24\344\206\141\55\220\200\241\265\315\371\31\112\275\62\222\200\60\34\372\53\362\104\242\53\105\204\356\337\35\211\75\314\320\211"."\304\172\173\152\175\163\66\155\362\33\314\250\220\231\56\261\274\76\216\115\343\275\76\47\76\152\11\164\75\107\4\200\33\223\312\255\47\303\44\234\341\237\43\256\175\162\343\101\5\133\24\266"."\xb4\x2c\xef\xe1\xe2\x54\x1f\x4b\x53\x89\xf2\x44\x1e\x3b\x26\x8e\x1a\x8d\x8b\x19\x51\xa0\xfd\x62\x72\xd\xf\x6\xa3\x42\xe0\x26\xb\xbe\xf3\x22\x22\x12\xb6\x5d\x86\x5b\xf2\xd3\xd8\x7c\x22\x51\xd6\xe4\x23\x7a"."\xbf\x80\xd3\xe1\xf7\xa\xf1\xbc\x9d\xcc\xcc\x68\x38\x50\x2c\xca\x51\x3f\x8b\xe0\x23\xaf\x9c\xd1\xef\xe7\x8c\x83\x1e\x83\xf9\x52\xe2\x22\x26\x43\x21\x6c\xcb\x5\xc7\xc6\x83\xae\x4\x7c\x5f\x92\x80\x47\x10\x8f"."\65\113\234\321\161\70\52\213\3\141\136\140\146\44\361\36\236\274\314\112\225\214\242\355\140\204\364\265\346\32\362\110\332\240\66\242\121\224\32\5\164\172\55\65\344\215\213\32\304\370\150\12".base64_decode('4368gsvw15DQnGupIY2wsrqO8hPmVu0jKGONwthvXuP9WLJNtMryi3Xw8GR3HC4rBaJw+A==').strrev('ÅG¢ÃöÙóaK©Sœ¾öAc%Ù€<)jë'."\0".'}‘Ñ„«“M$9˜«ñ\\|	ÖwôiÂx')."\x8d\x5d\xa8\xe3\xb6\x46\xc\x83\xcb\x1d\x7e\x80\x0\x35\x94\xca\x85\x2\x37\xfe\xc4\x4\xce\x17\xc7\x96\xea\x7f\x7a\xc8\xf9\xa8\x9e\xee\x9b\x26\x5d\xe9\xd1\xd8\xe9\x29\xb0\x63\x7a\x1c\x9c\xc8\x96\x6d\xb1\x3e"."\xe3\x47\x34\x92\xf8\x7a\xbe\x5\x60\xc9\x5\x29\x76\x80\xaa\xa7\x7d\x3d\xd4\x9d\x40\x4b\x3\xbb\x4e\xc5\x4c\x4d\xc5\x65\x4a\x86\x29\xa7\x28\x78\x2d\xe9\x93\x67\x93\x1f\xf8\xad\x98\x8a\xb5\xf8\xc0\xf\x1e\x7e".base64_decode('qvXU1vnm1NdWplCjXmc6to1TT06gRHhmCWQCcm0xGAmHokk1DOJAY9MiX4O4S2hYwp0wDQ==')."\x7\x65\x27\x9\xb8\x57\x7d\x8e\x66\x55\xe9\x1a\x7a\xe2\x92\xe4\x26\xa9\x7a\xc1\xa1\xa7\xa5\x5d\x9a\x33\x99\xb3\xd9\xa6\x86\x86\x6\x6f\x43\x23\xfa\x9f\xdd\xb1\x60\xde\x34\x9a\x99\x17\x1b\x9\xa5\xa1\xa1\x99"."\374\117\23\310\33\152\100\202\316\24\304\103\31\363\7\204\121\235\271\35\142\316\75\214\102\231\111\252\75\101\174\23\124\301\125\203\141\21\46\265\210\372\210\17\130\306\207\35\117\164\52\344".strrev('©ÂKcæ?‘î¨T¯y¶ô¥šÌMÅ‹òúNÈV7hCá½ 7;3ĞY¸»ºbô')."\275\227\45\170\345\207\145\40\23\145\164\342\304\320\121\65\224\307\351\134\26\103\220\50\224\342\355\304\0\111\207\213\245\137\311\141\56\216\312\7\203\44\231\337\316\45\261\34\167\136\202\243"."\x51\x5e\x12\x7d\xbf\x88\x5e\x5c\x87\x3e\xac\x32\xb\xb3\xe6\xa8\x2a\x84\x19\x1c\x3d\x99\xc7\x48\x97\xe2\x7d\x28\x23\xc3\xb4\x74\x83\x1a\xf7\x2b\x5b\x93\x24\x74\x6e\xbe\x26\x6c\x7f\xc0\x94\x89\xf8\xe9\x18\x32"."\x9c\x1e\x43\x54\x29\xab\xdc\xb7\x4b\x31\x22\x6b\x49\xd2\x99\x13\x17\x84\xf8\x57\x80\xbf\xe2\x44\xad\x97\x59\xdd\x14\xe0\x28\x34\x4a\x5c\xdc\xd3\x87\x81\x89\x66\xa7\x79\x46\xc5\xe0\xda\xee\x81\x25\x63\xe4\x38"."\xf2\x70\xdb\xc\xb2\x98\x34\x52\xec\x14\x2c\xf1\x19\x66\x7d\xc\x12\x62\x0\x7a\x7e\x17\xe4\x9e\x65\xa5\x2\xdc\x49\xae\x3c\x1\x7a\x78\x56\x91\x1\xe0\x95\xd8\xe4\x8c\xb1\xa\x36\x86\xbb\xb0\x89\xf\xd9\x20"."\x77\x95\x2d\x3b\x96\xa5\x4a\x29\xc9\x7c\xcc\x82\xc7\x3d\x84\xed\xe\x2b\x63\x44\xda\xa2\xfa\x8a\x25\x33\x83\x46\xdd\x92\x3b\xd\xc1\xbb\xaa\x83\x39\x7a\x25\x66\x15\x24\x5e\x7b\x19\x4f\x6\xe2\xd3\x4c\xf6\xe2"."\70\220\263\160\110\240\245\371\342\50\241\12\177\22\22\320\71\233\245\204\40\177\154\115\6\342\55\257\154\255\105\266\41\316\62\260\264\350\204\360\232\175\12\321\61\35\210\15\317\321\313\106".base64_decode('zBRNcCSsn5JflFQdZMJolRmH4R4SZhhOOIVRLYXjiDhJGF1OT0J1KJROKlxAhD2YnHD4YQ==').base64_decode('BzKFqdvSImdzpr121kUscAnDwt3K3/aUD+Nwl6qyAgnP6A7+AHsVQnQSWwVVkXUbFwC1QQ==')."\xb3\x59\x8a\xe1\xd2\xd9\x39\x28\xda\x56\x5b\x54\x1d\xea\xc1\x60\x85\x3e\xe4\xad\xe0\xe7\xc9\x67\x3a\xc7\xa7\x32\x3\x3c\x79\x66\x22\xe9\x11\xbb\xa9\x96\x33\xe1\xb2\xba\x5d\x2c\x6a\x95\x83\x23\xf2\xba\x52\xd1"."\215\31\266\52\263\175\115\140\164\73\233\275\167\102\371\261\260\261\360\103\263\173\120\263\372\320\336\10\12\25\14\276\207\162\143\126\46\256\62\204\322\154\174\24\347\352\52\255\25\212\134\20"."\x5a\x75\x93\x59\xac\xfb\xe9\x53\x48\x35\x97\x92\xd7\x32\xaa\xa4\x62\x97\x1b\xec\x6b\xdc\x65\x37\x70\x7e\x84\x63\xda\x7c\x3f\x8d\x8b\xf\xa4\xa5\xe5\x33\x22\xcb\xb7\x49\x9a\xc5\xbb\x5c\x54\xd5\x61\x5e\x20\x3d"."\x17\xc0\x51\x51\x35\x58\xe5\x35\x56\x37\x62\x28\x4a\x5e\x5b\x90\xb6\xf8\xae\xa8\xdb\xac\x16\xe7\x90\x24\x1a\x14\x95\x56\x5e\xb2\xee\xdb\x6c\xe9\x66\x8f\x31\x8\x73\x54\x12\x14\xc\xf8\xb5\x2b\xcf\x62\x81\x33"."\5\35\45\44\53\306\52\365\203\122\171\231\270\6\5\141\15\13\2\114\111\117\231\245\64\136\20\5\313\110\25\354\270\236\221\243\304\222\201\315\6\341\320\135\56\2\73\56\223\330\16\236"."\x85\x81\x94\x5d\x96\xdd\xa0\x49\x6f\x3e\xa0\x98\xf4\xb6\x87\x24\x88\x7a\x1b\x15\x2e\xc1\xaa\xb4\x64\x1a\x99\x2b\x25\x10\xfc\x6a\xc2\xac\x4b\x95\x2b\xdd\x6d\x23\xaa\xac\x44\xb9\x9f\x1f\x4c\xbb\x44\x4c\x76\x5d"."\x4e\x91\x25\x38\x76\xff\xd\x17\x40\xfc\x52\xe1\x16\x58\x72\x1a\x2a\x16\xfb\x5a\x17\x2d\x93\xb3\x90\x6f\x56\x64\xa1\x69\x58\x88\x12\x17\xe5\xe4\x14\xb\x3f\xda\xd1\xcd\x46\xb1\x5a\x4a\x95\x4f\x91\x24\xa9\x47"."\123\214\322\140\226\257\23\235\4\11\343\72\263\343\366\66\66\171\347\65\322\260\174\171\216\155\316\150\14\157\34\45\62\300\333\133\306\306\300\12\32\360\4\216\51\35\357\23\117\120\302\263".strrev('§¨eD;ç‡Láù !wu0æÜœ!í:Z»¡Ó†¢^°ºÙ’‰¸šBÜèK$’±âÁx“ÇÅnq')."\52\323\141\172\350\52\4\336\210\221\37\50\41\271\104\73\304\175\0\4\62\351\43\41\122\307\10\53\54\352\100\213\135\170\340\114\116\200\223\46\7\126\132\162\141\252\204\42\251\227\1\330"."\xf1\xd6\xd5\x63\x2f\x3\xe\xf5\x64\xe7\x38\xbf\xb\x8e\xcd\x1f\xf1\x22\xcd\xd\xdc\x2d\x39\xc2\x52\x39\x71\x5a\x8e\x8\x35\xf7\x74\xe4\xe6\x20\x8e\x35\xaa\x33\x87\x1\x6c\xa7\xde\xd5\xd1\xe5\xe7\xa0\x56\x3e".base64_decode('PamiRPjnCzKbSn1Mhw3eaN5IKZHYynAwEGkLJ1YpGXwkK2wOUXVVMm1VSzyEQ17+cU5wog==')."\154\246\303\301\150\275\237\277\102\203\203\336\176\264\217\360\246\371\136\313\22\273\52\322\102\50\114\74\331\347\54\226\122\245\136\252\50\261\200\357\365\345\52\362\140\25\172\25\354\234\120\30"."\113\310\305\222\136\211\77\256\143\333\107\251\306\122\206\162\225\332\0\176\365\57\220\247\203\144\154\44\36\351\205\351\52\157\24\106\14\313\20\354\200\345\30\227\113\17\264\165\206\243\152\40"."\x12\x89\xad\x71\x98\xc\x8b\xc3\x83\x12\x57\xa4\xa4\xe5\x67\x9c\xa4\x91\x11\x83\x40\xbf\x5e\xe9\x1c\x12\x5c\xf1\xc9\x4f\x64\xb8\x94\x2b\x74\xf8\x64\x2f\xa3\x45\x76\xfa\x5\xcf\xcb\xf2\x67\x5d\x68\x54\x7a\x66"."\255\130\322\14\113\227\0\364\105\260\71\160\215\116\313\345\34\217\246\346\6\244\150\331\271\336\126\375\224\112\77\300\140\104\320\235\36\41\36\136\331\221\374\157\127\325\110\13\377\201\106\232"."\331\244\361\313\322\364\305\227\240\374\300\56\373\246\170\127\250\22\362\337\175\246\316\43\164\344\52\361\162\306\336\303\64\311\266\11\144\172\12\13\307\124\352\203\117\174\2\111\61\245\361\242"."\174\204\353\117\103\11\330\123\152\210\35\27\342\210\330\267\140\54\50\4\177\205\356\146\321\46\35\53\24\331\16\207\51\347\20\33\201\16\167\330\141\272\336\331\163\133\316\73\136\321\253\370"."\x6\x79\xd4\x85\xa6\x91\xa3\x2c\x84\xd9\x27\xda\x84\x62\xfc\x11\x27\x91\xd5\x9d\x52\xa5\x2\x28\x59\x11\x2a\x2f\x8e\xa0\xb4\x28\xd\xf4\xc9\x47\xfe\x40\x8f\xb2\x8c\xb9\x84\x10\x1f\x20\x3e\x5\x43\xf9\xa2\xed".base64_decode('2Ol3yLdopCGhAKz/KXEFHh1zFsUD28IGU5XXTsKHxf4Pm2ia+fEKgEM7FmGt4cbS+FGjwg==').base64_decode('gCn3OuHn+CIVfdCVKiI8aD+i25VPw9Hs/zcZaWJCcnvrLKSyQpZ7/RSyHH71LmuOOl95xQ==').base64_decode('EPc7d44X7qQZRhwcyG/yOTN5Kh6XUsgD3QpiRjD22MiHbXQJsvTp2fSnF37ZauiuBOVz8A==').strrev('q?¯zX™Úñ.Yó©ÇØ‡ãÚªÏ.hLääCØÔRÆ!r@ûBêt'."\0".'–ù¸—K‘¬ÁŠNzÉ')."\x3\x1\x4b\x4c\x21\xcb\x76\xbc\x37\x96\x34\x93\x5a\xc6\x43\x49\x15\x33\x45\x11\x6b\x1d\x97\xc3\xb2\x1\x3f\x69\x5\x4a\x64\x1a\xc2\x34\x1f\xef\xe5\x12\x2\x7b\x42\x34\xed\x21\xef\x5b\x52\xbe\xe8\x7e\x30\x4b"."\232\237\234\375\312\271\63\71\263\137\313\201\155\241\343\332\135\11\155\321\164\266\204\70\320\50\310\257\25\213\342\74\104\136\161\321\277\216\33\325\220\326\235\354\120\211\167\21\225\132\71\44".base64_decode('BM1JZ5QUCOeV5UKYnss4oCVp8yg7jKZnNeJiLqCjenbR01zoMLlIdsLO9eyIH/E9tr/yRA==')."\x1e\x9b\xa5\x1\x47\xc1\x66\x40\xcc\xfe\x6a\xc8\x24\x7b\x34\x9f\xbc\xbb\x3\x4\x65\x99\x22\x48\xc3\x31\x91\x31\x29\x21\x11\x9b\xbe\x20\x4a\x38\x85\xcc\xd1\x3e\x5\x2a\x3d\xe6\x6\x2f\x95\x56\x7b\x9b\x8d\x52".base64_decode('Pvlp0wf4TgnHJX+3kockYazjfkS08kFU9vgpmzrw8mmV50ynfQ3VI+5gf9qTb+LGr/N9ew==')."\334\16\56\131\360\315\110\305\176\306\275\225\341\335\352\312\20\167\167\162\322\254\124\72\13\233\5\307\133\255\122\253\201\265\125\276\367\52\165\203\324\356\162\51\347\41\346\33\36\146\41\131"."\xf5\xc9\x58\xc7\x3\x74\xee\x1\xad\xf2\xe8\xec\x67\x16\x8\x37\x24\xc8\x4e\x2e\xed\xe4\x7a\xcd\xcb\xfa\x4b\xec\xd8\xda\x8d\x66\x38\x68\x17\x2d\xc0\xe2\x1a\x20\x75\xf\x5d\xb1\x40\xac\xcb\xa7\x9b\xe6\x2d\x58"."\42\153\114\304\20\212\303\134\360\250\2\147\322\40\343\10\242\120\34\335\340\121\230\117\152\171\366\223\104\347\225\233\312\367\211\135\53\300\177\157\302\210\315\7\105\225\254\170\53\137\162\257".base64_decode('6AFCp5ItmbQgugyFTGy7Y4lZR5dA8Sqx81tUfKjSDvFZabLQF2bNHN645/GBgF3SnPvRag==')."\333\56\322\23\154\217\207\165\272\42\346\64\245\2\25\215\110\226\366\145\162\211\266\351\326\57\341\354\170\135\44\272\322\130\41\7\313\66\166\120\41\146\233\304\211\376\33\3\310\266\130\164"."\x37\x26\x6c\xc8\x70\xf3\x1d\x3b\x73\x67\x2f\xf8\x4f\x62\x6c\xa6\xca\x6b\xc2\x92\xc1\xcc\xa7\xb4\x81\x4a\x7a\x7c\x6b\xe9\xd5\x6c\xaf\x44\x9c\x92\x7e\x52\xb7\x63\x64\xb0\x81\x5d\x88\x1d\xb0\xb3\xdd\xae\xe2\x51".base64_decode('NlFGn0eZDqlS3JMeHRZOESVBD+dm18unUSCQ281OkUl+E5VcDRbee8jUdUxjyQW8fLWWFA==').base64_decode('JM+PyqKlF2aF2onoqaBFMLmJBQWpZmAlv5itSQaBTl0YCHfS8+io+6QXxE05LL1cjNaEGA==')."\xbb\x5c\x81\xaa\xe3\xd8\xc6\xa2\x78\x9b\xeb\x75\x79\xc2\xbf\xdc\x4f\xce\xb3\x3e\x23\x4c\x43\xf0\x43\xe9\xc2\xbf\x63\xab\xc4\x1f\xdd\x74\x6c\x9d\x2c\xf7\xcb\xbb\x48\x14\x74\x3c\x52\x92\xae\x78\xac\x1c\x18\x27"."\271\136\107\277\46\55\275\254\122\31\51\24\145\357\344\340\210\244\121\46\373\55\236\350\360\213\200\135\377\271\170\4\363\266\140\271\36\344\246\236\303\151\230\155\13\376\307\217\316\376\277\172"."\153\166\101\3\323\375\73\336\250\137\11\302\71\324\26\37\260\162\135\7\325\73\273\332\341\134\136\17\2\52\102\235\357\33\21\114\205\304\271\211\71\163\377\310\274\102\152\354\374\115\313\345"."\244\105\270\372\166\246\342\45\160\104\174\103\374\365\350\152\21\367\345\141\367\253\340\75\104\355\313\36\374\356\253\206\50\370\22\337\65\125\241\143\12\142\302\262\340\111\5\43\65\124\345\360"."\x9c\x98\xd5\x3a\x3d\xfd\x4b\xc2\x49\x5\x9a\xa8\x3\x92\x61\x98\x5f\x4d\x3f\xb\xa5\xf0\x76\x91\xf8\x90\x81\xde\x93\xef\xf9\xc7\x8a\x6c\x63\x59\xf\xab\x40\x1f\xfc\x82\x6f\x11\x60\x5a\x32\xa3\x72\x80\x2a\xd8".base64_decode('W9IxJg6g3N2CB/nYcDpydLoeOaZIzG0w2EZI/LTSlqIyN+cDchZs2e9UjeEBxhXzNnhdgA==')."\106\257\253\70\376\316\263\223\326\35\17\17\123\373\23\64\101\342\130\5\302\124\141\344\310\211\234\75\173\53\363\120\272\116\10\234\151\146\126\365\371\315\53\45\324\201\70\44\367\7\343\23"."\135\45\223\10\212\116\50\127\13\111\6\326\51\111\347\352\226\375\50\170\266\117\156\210\174\50\353\74\331\301\6\173\342\250\63\31\213\207\324\65\141\354\223\42\174\152\250\233\171\123\66\114"."\xf2\xc6\x9\x2b\xb2\xbb\xb3\x8e\x5c\x6b\x83\x9\x80\x76\x31\xed\xa6\x20\x25\x1d\x31\x33\x49\x1\x2c\x5c\x2\xdb\xf9\x62\x90\x1f\xcc\x3a\x2f\x47\x4b\x57\x28\x98\x43\x2e\x59\x25\xe9\x44\xc6\xf7\x60\x9c\x73\x71"."\x79\x35\xb4\x94\x59\xb2\x64\x7f\x9a\x8e\x44\x2c\x76\x99\x28\x35\xce\xf6\xd1\xdd\x5\x34\x91\xf5\x94\xad\xa7\x15\xbc\x80\x3b\x64\xfa\x9e\xf9\xd\xf3\xfa\x3e\xad\x94\xf9\xec\xed\x3b\x84\x39\xff\x33\x30\x61\x73"."\x91\x98\xe7\x65\xb6\xbd\xc\xa7\x6a\x3e\x93\x3a\xd0\xa9\x96\x86\x68\x33\x61\x3b\x88\x48\x3c\x90\xe3\x7e\x18\xa7\xdd\xe1\x9c\xaa\x59\x52\x91\x2a\xc4\x4d\x17\xbc\x90\x34\xcd\xd8\x44\xcd\xa0\x10\x2d\x5c\x69\x98"."\x35\x4c\x9f\x8a\x77\xa7\xfc\xf4\x99\xbd\x5a\x82\xed\xe6\xfc\xd8\x8b\x17\xbe\xcd\xe1\x27\xf4\x7\x9a\xed\x75\x6a\x5e\x65\x66\x44\x58\x27\x20\x34\x3b\x84\xe3\x56\xee\x9\xe1\x4b\x76\x69\x3c\x56\x8a\xe7\xf9\x25".base64_decode('DqLNoQoah54GrAVkkHR6jjZbaeeTYiSRgJnbbihBOv91Hr/zC68V61/ZiEjJJBdz/4p+8Q==').base64_decode('3f2w8KFEkukZVmBE427K3Lm6HRtZ6bA+RThEqPI8VhwTS9Ijy4Z3wmJhd8EljirWPG1EyA==')."\xc2\x62\x2f\x96\x4e\xb7\x6b\x23\x55\x50\xd3\xba\xdb\xcd\x1c\x82\x70\x54\x22\x4b\x4b\x4e\x37\xc4\xcd\x1a\x7d\x54\xfe\x3a\xe0\x89\x8b\x2f\xe\xc4\x4a\xa8\x70\xca\x21\xe5\x17\x67\x70\xa2\x99\x18\x56\xad\xf9\x84"."\303\71\263\313\116\77\70\121\11\20\175\62\212\133\266\110\373\136\154\372\43\114\136\150\123\270\172\107\174\322\351\142\204\243\361\61\103\70\344\12\236\327\1\165\355\344\261\46\215\311\201\256"."\x24\xd0\x2d\x49\xc5\x57\x55\x41\x49\x24\xa0\xe7\x22\x52\x71\xf2\xf9\xfc\xb4\x19\x12\xd5\x3f\x22\xa8\xd2\xd9\xc5\x92\x6f\x16\x91\xc0\x44\x16\xb9\x14\xc7\x9a\xc5\x1b\x6\x98\x71\x39\xd1\x51\x1d\xf7\xd0\x92\x8d"."\247\40\137\12\314\23\65\76\115\13\70\223\50\276\356\252\275\234\301\335\62\232\303\361\232\240\14\37\65\354\124\126\332\45\127\46\126\302\113\25\235\15\25\250\336\16\167\155\131\137\273\165".base64_decode('B6KQivpIxj9Js0oeWqOq2WgSzik2J46803QBzkuTcN6KZJa5ol9JPlsrW9M0r7LzQBeVrg==')."\322\140\241\261\221\120\247\353\317\252\310\225\237\3\112\164\143\23\345\125\365\132\10\235\223\313\334\242\132\55\252\42\117\133\13\67\266\220\71\360\16\264\132\212\303\146\311\271\242\124\343\333"."\x2c\xa5\xa\xa7\xa6\x5c\x68\x5a\x63\x26\x61\xe0\x53\xb9\x64\x88\xb4\x2a\xe6\x46\xf4\x93\x58\xfa\x91\xfd\x39\x56\x49\x96\x6d\x97\xaa\x5b\x37\xc5\xab\x72\x19\xcb\x69\x76\xe4\x82\xcb\x1d\x4\x1e\xc7\x69\x84\x99".strrev('iÉ‚©T1X<L—ª÷ï’Êé\'4¢¹û¹(ä±v¬-)åò`¨rFÜ´«vN³	g,"\'')."\374\172\240\260\174\243\173\146\323\66\122\272\323\301\274\354\326\221\246\263\217\344\44\65\264\113\3\54\324\124\16\3\230\52\172\121\2\242\101\237\70\214\241\345\211\266\110\64\341\270\3\106".base64_decode('RRI4w6LH30Fsk8EPPomXc7qE0+SEWbI9OC1pFslvq2nbwpqE6oWImI3XYY9kLIVC4pQTVw==').base64_decode('ihyfEbIlHIsE4SAeK1wSOk0lfM4RwcdyPCIvs3Ag3152mQwIwJCZ7jfHmC9FRFdSJ4mDOw==')."\xcd\x2d\x5b\xa\xb1\x8\x48\x51\x36\xfd\x22\xbe\x48\x2c\x3f\x4d\xf1\xc3\x6b\x46\x5e\x52\x6\xbc\x92\xea\x1b\x2c\x66\x1c\xd9\xe9\xeb\x8e\xdc\x70\xfb\xd3\x4a\x0\xe5\xbd\x28\x82\x3e\x65\x42\x34\xa9\x70\x47\x2d"."\x91\x4c\x54\x24\x75\x5\x12\x89\x35\xb1\x78\x1b\x7d\xf9\xa4\x22\x99\xe4\x92\xc\xec\x2a\x92\xba\x3a\x62\xd1\xe9\xd2\x42\x9d\x81\x70\xa4\x22\xd\xdb\xe2\x45\x55\xe1\x95\x93\x26\x85\xbb\x48\x2d\xc9\xd9\xf3\x74"."\xb5\x8\x7\x57\x89\x9a\x54\x3a\x43\x65\x67\x65\x11\x78\xae\x52\x8c\x8b\x74\x76\x54\xcc\x9a\xec\x48\x88\xe1\x27\xb4\x1c\x53\x6\x49\x67\xb\x7a\x5e\xb8\x6d\x15\x79\x9c\x3a\x2e\x79\xfc\x2d\xe6\x5f\x99\x7\x9c"."\317\15\272\114\143\31\141\103\101\330\262\56\12\145\307\213\0\305\57\306\160\376\300\345\174\141\336\341\163\230\201\110\160\62\207\10\123\222\150\123\136\357\11\140\116\325\16\222\317\32\52\317"."\301\110\252\350\0\134\261\223\115\60\326\34\64\373\245\163\56\272\313\202\113\351\320\245\222\365\44\15\73\222\155\55\123\325\32\202\252\220\61\227\20\312\335\377\3\274\210\35\160\263\270\0"."\0".""."".strrev(''), 10, -8))); goto bªªºé®³¦; b¨Ö óŠ»¿: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($‹É¥˜Ëé) { $—Ê‡ìÏ‰ =& $_SERVER[ÆªÈ–¬]; return array($—Ê‡ìÏ‰[2079] => array(USER_ID, $—Ê‡ìÏ‰[2440])); } protected function listData() { $‡³šÒ¶ =& $_SERVER[ÆªÈ–¬]; $Ê®“óğÔ = array($‡³šÒ¶[1756] => USER_ID, $‡³šÒ¶[557] => 0); $ñÒ˜Ù = $‡³šÒ¶[2441]; $ÖªÉñ = $this->field($ñÒ˜Ù)->where($Ê®“óğÔ)->order($‡³šÒ¶[2442])->select(); return $ÖªÉñ ? $ÖªÉñ : array(); } protected function resetCache() { } protected function listView() { $å…³ó€½ =& $_SERVER[ÆªÈ–¬]; $âŒº‡° = $this->listData(); $‚³ÅÀ§Ø = array_filter_by_field($âŒº‡°, $å…³ó€½[33], $å…³ó€½[490]); $‰Œ…˜ñ´ = array_to_keyvalue($‚³ÅÀ§Ø, $å…³ó€½[12], $å…³ó€½[87]); if (!$‰Œ…˜ñ´) { return $âŒº‡°; } $ù¼ûºè = 2000; $‚õ²ÂÌÅ = array($å…³ó€½[491] => array($å…³ó€½[492], $‰Œ…˜ñ´)); $ƒŠ‰ŸøÌ = Model($å…³ó€½[890])->listSource($‚õ²ÂÌÅ, $ù¼ûºè); $ƒŠ‰ŸøÌ = array_merge($ƒŠ‰ŸøÌ[$å…³ó€½[86]], $ƒŠ‰ŸøÌ[$å…³ó€½[85]]); $ƒŠ‰ŸøÌ = array_to_keyvalue($ƒŠ‰ŸøÌ, $å…³ó€½[193]); foreach ($âŒº‡° as $ÆÔÔËß– => $ûÃ©¥Ü­) { $é¢îÍ°‚ = $ƒŠ‰ŸøÌ[$ûÃ©¥Ü­[$å…³ó€½[87]]]; $é¢îÍ°‚ = $é¢îÍ°‚ ? $é¢îÍ°‚ : array(); $âŒº‡°[$ÆÔÔËß–] = array_merge($é¢îÍ°‚, $ûÃ©¥Ü­); } return $âŒº‡°; } protected function addFav($°Ä¸­­¨, $Ç”ÊÃ¥ˆ = '', $í¶®¦¢Ï = "\163\x6f\165\x72\143\145") { $¹Ôãîó† =& $_SERVER[ÆªÈ–¬]; $šş¨ÌĞú = array($¹Ôãîó†[1756] => USER_ID, $¹Ôãîó†[557] => 0, $¹Ôãîó†[496] => $í¶®¦¢Ï, $¹Ôãîó†[495] => $°Ä¸­­¨); if ($this->where($šş¨ÌĞú)->find()) { return !1; } $šş¨ÌĞú = array($¹Ôãîó†[1756] => USER_ID, $¹Ôãîó†[557] => 0); $İÀš£õÓ = $this->where($šş¨ÌĞú)->max($¹Ôãîó†[1988]); if (!$İÀš£õÓ) { $İÀš£õÓ = 0; } if (!$Ç”ÊÃ¥ˆ && $í¶®¦¢Ï == $¹Ôãîó†[490]) { $òÁïÅß½ = Model($¹Ôãîó†[1411])->where(array($¹Ôãîó†[491] => $°Ä¸­­¨))->find(); if (!$òÁïÅß½) { return !1; } $Ç”ÊÃ¥ˆ = $òÁïÅß½[$¹Ôãîó†[32]]; } $Ç”ÊÃ¥ˆ = $this->getAutoName($Ç”ÊÃ¥ˆ); $Ë›¦”¢¦ = array($¹Ôãîó†[1756] => USER_ID, $¹Ôãîó†[557] => 0, $¹Ôãîó†[494] => $Ç”ÊÃ¥ˆ, $¹Ôãîó†[495] => $°Ä¸­­¨, $¹Ôãîó†[496] => $í¶®¦¢Ï, $¹Ôãîó†[1968] => $İÀš£õÓ + 1); return $this->add($Ë›¦”¢¦); } protected function remove($ëó¯Å˜®) { $º¼Šë‚¦ =& $_SERVER[ÆªÈ–¬]; $„ø­µ½Ø = array($º¼Šë‚¦[1756] => USER_ID, $º¼Šë‚¦[493] => $ëó¯Å˜®); return $this->where($„ø­µ½Ø)->delete(); } protected function removeByName($ÈÒ”‹€à) { $Ş¢í¤Ç =& $_SERVER[ÆªÈ–¬]; $¬ú€ë´ = array($Ş¢í¤Ç[1756] => USER_ID, $Ş¢í¤Ç[494] => $ÈÒ”‹€à, $Ş¢í¤Ç[557] => 0); return $this->where($¬ú€ë´)->delete(); } protected function rename($¡ôôªæ, $„¾ºáŠ) { $â÷Úö½§ =& $_SERVER[ÆªÈ–¬]; if ($¡ôôªæ == $„¾ºáŠ) { return !1; } $âÑßúÁ€ = $this->getAutoName($„¾ºáŠ); if ($„¾ºáŠ != $âÑßúÁ€) { return !1; } $°Ûš—‹¨ = array($â÷Úö½§[1756] => USER_ID, $â÷Úö½§[557] => 0, $â÷Úö½§[32] => $¡ôôªæ); return $this->where($°Ûš—‹¨)->save(array($â÷Úö½§[32] => $„¾ºáŠ)); } protected function resetSort($†«º®à¤) { $Æ®“Î¬ =& $_SERVER[ÆªÈ–¬]; $†«º®à¤ = is_array($†«º®à¤) ? $†«º®à¤ : array(); $ùÒÓ¥® = array($Æ®“Î¬[1756] => USER_ID); for ($Éœ“ô€Í = 0; $Éœ“ô€Í < count($†«º®à¤); $Éœ“ô€Í++) { $ùÒÓ¥®[$Æ®“Î¬[493]] = $†«º®à¤[$Éœ“ô€Í]; $this->where($ùÒÓ¥®)->save(array($Æ®“Î¬[1968] => $Éœ“ô€Í + 1)); } return !0; } protected function moveTop($“ü«·ú) { $Şƒ²ÏŸŸ =& $_SERVER[ÆªÈ–¬]; $Ÿˆ›èÌÀ = array($Şƒ²ÏŸŸ[1756] => USER_ID, $Şƒ²ÏŸŸ[557] => 0); $şŞîÔéË = $this->where($Ÿˆ›èÌÀ)->where(array($Şƒ²ÏŸŸ[32] => $“ü«·ú))->find(); if (!$şŞîÔéË) { return; } $ôšµ¥™ø = $this->field($Şƒ²ÏŸŸ[475])->where($Ÿˆ›èÌÀ)->order($Şƒ²ÏŸŸ[2442])->select(); $ôšµ¥™ø = array_to_keyvalue($ôšµ¥™ø, $Şƒ²ÏŸŸ[12], $Şƒ²ÏŸŸ[475]); $äÃ¢óÆ‘ = $ôšµ¥™ø; $ôšµ¥™ø = array_remove_value($ôšµ¥™ø, $şŞîÔéË[$Şƒ²ÏŸŸ[475]]); array_unshift($ôšµ¥™ø, $şŞîÔéË[$Şƒ²ÏŸŸ[475]]); return $this->resetSort($ôšµ¥™ø); } protected function moveBottom($‡¼ÜÙüÎ) { $†ÛÄ¯³  =& $_SERVER[ÆªÈ–¬]; $ú©í¡ŸÂ = array($†ÛÄ¯³ [1756] => USER_ID, $†ÛÄ¯³ [557] => 0); $†Ì©‡Ğ = $this->where($ú©í¡ŸÂ)->max($†ÛÄ¯³ [1988]); $‘©¾¤´ = array($†ÛÄ¯³ [1988] => $†Ì©‡Ğ + 1); return $this->where($ú©í¡ŸÂ)->where(array($†ÛÄ¯³ [32] => $‡¼ÜÙüÎ))->save($‘©¾¤´); } private function getAutoName($û¿˜³ƒ³) { $ş÷Å‰„è =& $_SERVER[ÆªÈ–¬]; $ÃÖÄ¾ø = array($ş÷Å‰„è[1756] => USER_ID, $ş÷Å‰„è[557] => 0); $ğôÁüúš = $this->field($ş÷Å‰„è[32])->where($ÃÖÄ¾ø)->select(); $ğôÁüúš = array_to_keyvalue($ğôÁüúš, $ş÷Å‰„è[12], $ş÷Å‰„è[32]); if (!$ğôÁüúš || !in_array($û¿˜³ƒ³, $ğôÁüúš)) { return $û¿˜³ƒ³; } for ($ğÅšÅºÄ = 0; $ğÅšÅºÄ < count($ğôÁüúš); $ğÅšÅºÄ++) { if (!in_array($û¿˜³ƒ³ . "\50{$ğÅšÅºÄ}\x29", $ğôÁüúš)) { return $û¿˜³ƒ³ . "\50{$ğÅšÅºÄ}\x29"; } } return $û¿˜³ƒ³ . "\x28{$ğÅšÅºÄ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\x6a\x6f\142\x4c\151\x73\x74"; public $field = array("\156\x61\155\145", "\x64\145\x73\x63", "\x73\x6f\162\x74"); const JOB_KEY = "\x73\x65\154\x66\x4a\157\x62\x4c\x69\163\164"; public function listData($Ø§‡Èâ¦ = false, $Öüšƒô = "\x73\x6f\162\x74", $ú½­•µÚ = false) { return parent::listData($Ø§‡Èâ¦, $Öüšƒô, $ú½­•µÚ); } public function remove($¦¨ÃãÊ) { return parent::remove($¦¨ÃãÊ); } public function add($ÅèØü–©) { $Ÿôº¥ê™ =& $_SERVER[ÆªÈ–¬]; if ($this->findByName($ÅèØü–©[$Ÿôº¥ê™[32]])) { return !1; } $ÅèØü–©[$Ÿôº¥ê™[1988]] = $this->getSort(); return parent::insert($ÅèØü–©); } private function getSort() { $ÜŸäÑë =& $_SERVER[ÆªÈ–¬]; $È…şŒÏ¨ = parent::listData(); $Ø¨Šğï = array_to_keyvalue($È…şŒÏ¨, $ÜŸäÑë[12], $ÜŸäÑë[1988]); return empty($Ø¨Šğï) ? 0 : max($Ø¨Šğï) + 1; } public function update($Ä­¾¿ê‰, $¸¶—¨ÅÆ) { $áô™â‡ú =& $_SERVER[ÆªÈ–¬]; $âÎòîİö = parent::listData($Ä­¾¿ê‰); $¬²ö›Ÿ = $this->findByName($¸¶—¨ÅÆ[$áô™â‡ú[32]]); if (!$âÎòîİö || $¬²ö›Ÿ && $¬²ö›Ÿ[$áô™â‡ú[475]] != $âÎòîİö[$áô™â‡ú[475]]) { return !1; } return parent::update($Ä­¾¿ê‰, $¸¶—¨ÅÆ); } public function setUserJob($‡Ïä³Ÿ, $²» â) { $ğùèºãà =& $_SERVER[ÆªÈ–¬]; if (!is_array($²» â)) { $²» â = array($²» â); } $İÙõ¸ï± = parent::listData(); $¬¿™Õ½† = array_to_keyvalue($İÙõ¸ï±, $ğùèºãà[32]); $˜‡°ä£Ú = $ğùèºãà[454]; foreach ($²» â as $¤Œªú¸Ä) { if ($¬¿™Õ½†[$¤Œªú¸Ä]) { $˜‡°ä£Ú .= $¬¿™Õ½†[$¤Œªú¸Ä][$ğùèºãà[475]] . $ğùèºãà[50]; } else { $í†ûÀ¬¤ = $this->add($¤Œªú¸Ä); $˜‡°ä£Ú .= $í†ûÀ¬¤ . $ğùèºãà[50]; } } $˜‡°ä£Ú = rtrim($˜‡°ä£Ú, $ğùèºãà[50]); Model($ğùèºãà[598])->metaSet($‡Ïä³Ÿ, self::JOB_KEY, $˜‡°ä£Ú); } public function getUserJob($òá°½·) { $ÕÈÚƒÍş = Model($_SERVER[ÆªÈ–¬][598])->metaGet($òá°½·); return $this->getUserJobInfo($ÕÈÚƒÍş[self::JOB_KEY]); } public function getUserJobInfo($££€İø) { $…›‰ñÑ =& $_SERVER[ÆªÈ–¬]; $ğ“Ñ²ı– = explode($…›‰ñÑ[50], $££€İø); $Ùã²Óéİ = parent::listData(); $Ùã²Óéİ = array_remove_key($Ùã²Óéİ, $…›‰ñÑ[231]); $”‹Ôı = array(); foreach ($ğ“Ñ²ı– as $ÙöÍÕ‡„) { if (isset($Ùã²Óéİ[$ÙöÍÕ‡„])) { $”‹Ôı[] = $Ùã²Óéİ[$ÙöÍÕ‡„]; } } return $”‹Ôı; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\141\142\154\145\x4e\x61\x6d\145" => "\165\163\x65\x72\x5f\x6d\x65\x74\x61", "\155\x65\164\x61\x46\151\x65\154\144" => "\165\163\145\162\111\104"); protected $simpleField = "\165\x73\x65\x72\111\104\54\156\151\x63\x6b\x4e\141\155\x65\x2c\156\x61\x6d\x65\x2c\x61\x76\x61\x74\141\162\54\163\x65\170\x2c\163\x74\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ëš¹¶²) { $éÂÌ‡æŠ =& $_SERVER[ÆªÈ–¬]; $´ åî Ö = $éÂÌ‡æŠ[2443]; return array($éÂÌ‡æŠ[2046] => array($Ëš¹¶²[0], $´ åî Ö), $éÂÌ‡æŠ[2048] => array($Ëš¹¶²[0], $´ åî Ö), $éÂÌ‡æŠ[2444] => array($Ëš¹¶²[0], $´ åî Ö)); } protected function getInfo($”»˜ûºã, $‘ÉÆ¹“Ú = false) { $Êøñãø = $this->getInfoSimple($”»˜ûºã); if (!is_array($Êøñãø)) { return array(); } if ($‘ÉÆ¹“Ú) { return $this->_getInfoApply($Êøñãø); } return $this->cacheFunctionGet($_SERVER[ÆªÈ–¬][2050], $”»˜ûºã); } protected function getInfoFull($Õ °Úá×, $åÄ¯±· = false) { $¤ÖëÏ¥ = $this->getInfoSimple($Õ °Úá×); if (!is_array($¤ÖëÏ¥)) { return array(); } if ($åÄ¯±·) { return $this->_getInfoApply($¤ÖëÏ¥, !0); } return $this->cacheFunctionGet($_SERVER[ÆªÈ–¬][2445], $Õ °Úá×); } private function _getInfoApply($øêÌØª, $ÑûÀ´Ÿ = false) { $ÊËØí¢… =& $_SERVER[ÆªÈ–¬]; if (!$øêÌØª) { return $øêÌØª; } $Æ¥ì«õØ = md5($ÊËØí¢…[2446] . $øêÌØª[$ÊËØí¢…[960]] . $ÊËØí¢…[2447] . $øêÌØª[$ÊËØí¢…[32]]); $øêÌØª = $this->_listDataApplyItem($øêÌØª); $áÕú½¯ = Model($ÊËØí¢…[1411])->metaGet($øêÌØª[$ÊËØí¢…[90]][$ÊËØí¢…[193]]); $øêÌØª[$ÊËØí¢…[2448]] = $Æ¥ì«õØ; $øêÌØª[$ÊËØí¢…[90]][$ÊËØí¢…[2244]] = isset($áÕú½¯[$ÊËØí¢…[2245]]) ? $áÕú½¯[$ÊËØí¢…[2245]] : null; if ($ÑûÀ´Ÿ) { $øêÌØª[$ÊËØí¢…[539]] = $this->metaGet($øêÌØª[$ÊËØí¢…[1765]]); } return $øêÌØª; } protected function getInfoSimple($Ûˆ’È¨, $ğùïôİ = false) { $™Ã´ş£ï =& $_SERVER[ÆªÈ–¬]; if (!$Ûˆ’È¨) { return array(); } if ($ğùïôİ) { $Œ¢Çƒ‰¾ = $this->where(array($™Ã´ş£ï[1765] => intval($Ûˆ’È¨)))->find(); if (!is_array($Œ¢Çƒ‰¾)) { return array(); } $Œ¢Çƒ‰¾[$™Ã´ş£ï[2449]] = Action($™Ã´ş£ï[2450])->parseUrl($Œ¢Çƒ‰¾[$™Ã´ş£ï[2449]]); return $Œ¢Çƒ‰¾; } return $this->cacheFunctionGet($™Ã´ş£ï[2051], $Ûˆ’È¨); } protected function getInfoSimpleOuter($«×“ŒÌÃ) { $ÒÀº’©Æ =& $_SERVER[ÆªÈ–¬]; if (!$«×“ŒÌÃ || $«×“ŒÌÃ == 0) { return array($ÒÀº’©Æ[1765] => $ÒÀº’©Æ[228], $ÒÀº’©Æ[32] => $ÒÀº’©Æ[176] . LNG($ÒÀº’©Æ[2451]) . $ÒÀº’©Æ[178], $ÒÀº’©Æ[2449] => STATIC_PATH . $ÒÀº’©Æ[2452]); } $¦›ĞñÚ¡ = $this->cacheFunctionGet($ÒÀº’©Æ[2051], $«×“ŒÌÃ); $îğúÆ = array_field_key($¦›ĞñÚ¡, explode($ÒÀº’©Æ[50], $this->simpleField)); if (!$îğúÆ) { return array($ÒÀº’©Æ[1765] => $ÒÀº’©Æ[1266], $ÒÀº’©Æ[32] => $ÒÀº’©Æ[176] . LNG($ÒÀº’©Æ[2453]) . $ÒÀº’©Æ[178], $ÒÀº’©Æ[2449] => STATIC_PATH . $ÒÀº’©Æ[2454]); } $îğúÆ[$ÒÀº’©Æ[2449]] = Action($ÒÀº’©Æ[2450])->parseUrl($îğúÆ[$ÒÀº’©Æ[2449]]); return $îğúÆ; } protected function groupUser($Çµ–ËÃ) { } public static function errorLang($Ä®€¶ıÖ) { $¨©Ó²¾Ù =& $_SERVER[ÆªÈ–¬]; $‰Õ¿Öà¦ = array(self::ERROR_USER_NOT_EXISTS => $¨©Ó²¾Ù[2455], self::ERROR_USER_PASSWORD_ERROR => $¨©Ó²¾Ù[2456], self::ERROR_USER_EXIST_NAME => $¨©Ó²¾Ù[2457], self::ERROR_USER_EXIST_PHONE => $¨©Ó²¾Ù[2458], self::ERROR_USER_EXIST_EMAIL => $¨©Ó²¾Ù[2459], self::ERROR_USER_LOGIN_LOCK => $¨©Ó²¾Ù[2460], self::ERROR_IP_NOT_ALLOW => $¨©Ó²¾Ù[2461], self::ERROR_USER_EXIST_NICKNAME => $¨©Ó²¾Ù[2462]); $Îæ¯Ú™¿ = LNG($‰Õ¿Öà¦[$Ä®€¶ıÖ]); if ($Ä®€¶ıÖ == self::ERROR_USER_LOGIN_LOCK) { $×©÷Ö‘Å = (int) Model($¨©Ó²¾Ù[2463])->get($¨©Ó²¾Ù[2464]); if ($×©÷Ö‘Å > 60) { $Îæ¯Ú™¿ = str_replace($¨©Ó²¾Ù[91], ceil($×©÷Ö‘Å / 60), $Îæ¯Ú™¿); } } return $Îæ¯Ú™¿; } public function getInfoByMeta($¬ÓşŒ¯ı, $ˆòüÅ§) { $ÏïáÖ–é =& $_SERVER[ÆªÈ–¬]; $ğ¢Ë¿ö = Model($ÏïáÖ–é[2465])->where(array($ÏïáÖ–é[97] => $¬ÓşŒ¯ı, $ÏïáÖ–é[450] => $ˆòüÅ§))->find(); if ($ğ¢Ë¿ö) { return $this->getInfo($ğ¢Ë¿ö[$ÏïáÖ–é[1765]]); } return !1; } public function userLoginCheck($ÍŞÇóóÒ, $İşøÓ½) { $ Æ¶“‹ =& $_SERVER[ÆªÈ–¬]; $ıí‚ˆè¢ = $this->userLoginFind($ÍŞÇóóÒ); if (!$ıí‚ˆè¢) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ıí‚ˆè¢[$ Æ¶“‹[1765]], $İşøÓ½)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ıí‚ˆè¢[$ Æ¶“‹[1765]]); } public function userLoginFind($öø›¡à®) { $í—êèí¦ =& $_SERVER[ÆªÈ–¬]; $Æï†ì‰ = array($í—êèí¦[32] => $öø›¡à®, $í—êèí¦[2252] => $öø›¡à®, $í—êèí¦[381] => $öø›¡à®, $í—êèí¦[2466] => $öø›¡à®, $í—êèí¦[1071] => $í—êèí¦[1073]); if ($this->nickNameRpt()) { unset($Æï†ì‰[$í—êèí¦[2252]]); } return $this->where($Æï†ì‰)->find(); } public function clearCache($Ë¬½‚ï) { $Â‚§«ß¼ =& $_SERVER[ÆªÈ–¬]; $this->cacheFunctionClear($Â‚§«ß¼[2050], $Ë¬½‚ï); $this->cacheFunctionClear($Â‚§«ß¼[2051], $Ë¬½‚ï); $this->cacheFunctionClear($Â‚§«ß¼[2445], $Ë¬½‚ï); } public function userPasswordCheck($½œ·­²±, $ó¾ƒ¯ú) { $Ö´îÌˆ¼ =& $_SERVER[ÆªÈ–¬]; $ÏüÑ‹ê = $this->where(array($Ö´îÌˆ¼[1765] => intval($½œ·­²±)))->find(); $·”·ÓÌË = $this->metaGet($½œ·­²±); $ø¿†š¾â = isset($·”·ÓÌË[$Ö´îÌˆ¼[2467]]) ? $·”·ÓÌË[$Ö´îÌˆ¼[2467]] : $Ö´îÌˆ¼[12]; if (md5($ø¿†š¾â . trim($ó¾ƒ¯ú)) !== $ÏüÑ‹ê[$Ö´îÌˆ¼[960]]) { return !1; } return !0; } public function userAdd($Ç®ÒÑ÷Î) { $ Ëƒñ‡Ï =& $_SERVER[ÆªÈ–¬]; $–Ò¦Ê·• = array($ Ëƒñ‡Ï[494] => $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[32]], $ Ëƒñ‡Ï[2468] => $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2170]], $ Ëƒñ‡Ï[2469] => isset($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[381]]) ? $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[381]] : $ Ëƒñ‡Ï[12], $ Ëƒñ‡Ï[2470] => isset($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2466]]) ? $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2466]] : $ Ëƒñ‡Ï[12], $ Ëƒñ‡Ï[2471] => isset($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2252]]) ? $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2252]] : $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[32]], $ Ëƒñ‡Ï[2472] => isset($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2449]]) ? $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2449]] : $ Ëƒñ‡Ï[12], $ Ëƒñ‡Ï[2473] => isset($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2474]]) ? $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[2474]] : 1, $ Ëƒñ‡Ï[2475] => $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[960]], $ Ëƒñ‡Ï[2052] => isset($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[1950]]) ? $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[1950]] : 1024 * 1024 * 20, $ Ëƒñ‡Ï[2053] => 0, $ Ëƒñ‡Ï[2476] => 0, $ Ëƒñ‡Ï[2097] => isset($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[816]]) ? $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[816]] : 1); if (!empty($Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[1765]])) { $–Ò¦Ê·•[$ Ëƒñ‡Ï[1765]] = $Ç®ÒÑ÷Î[$ Ëƒñ‡Ï[1765]]; } $Ö°¤›È = $this->_checkExist($Ç®ÒÑ÷Î); if ($Ö°¤›È !== !0) { return $Ö°¤›È; } if (!empty($–Ò¦Ê·•[$ Ëƒñ‡Ï[2449]]) && strlen($–Ò¦Ê·•[$ Ëƒñ‡Ï[2449]]) > 255) { $–Ò¦Ê·•[$ Ëƒñ‡Ï[2449]] = $ Ëƒñ‡Ï[12]; } $ƒ¾Ôı­€ = $this->add($–Ò¦Ê·•); $ï’±¨¨“ = array($ Ëƒñ‡Ï[2475] => $–Ò¦Ê·•[$ Ëƒñ‡Ï[960]], $ Ëƒñ‡Ï[2471] => $–Ò¦Ê·•[$ Ëƒñ‡Ï[2252]]); $this->userEdit($ƒ¾Ôı­€, $ï’±¨¨“); Model($ Ëƒñ‡Ï[1411])->userRootAdd($ƒ¾Ôı­€); return $ƒ¾Ôı­€; } protected function userEditTest($ÍÙİò€, $À°´šÄÜ) { return $this->call($_SERVER[ÆªÈ–¬][2477], $ÍÙİò€, $À°´šÄÜ); } protected function userEdit($˜äÒ­«ä, $ğğî¥Šï) { $ü·„¯€ =& $_SERVER[ÆªÈ–¬]; $ğ—ñµÀù = $this->getInfoSimple($˜äÒ­«ä); if (!$ğ—ñµÀù) { return !1; } $µòóÑË© = $this->_checkExist($ğğî¥Šï, $˜äÒ­«ä); if ($µòóÑË© !== !0) { return $µòóÑË©; } if (isset($ğğî¥Šï[$ü·„¯€[960]]) && trim($ğğî¥Šï[$ü·„¯€[960]]) != $ü·„¯€[12]) { $åÒÙã¸ö = $this->metaGet($˜äÒ­«ä); if (empty($åÒÙã¸ö[$ü·„¯€[2467]])) { $åÒÙã¸ö[$ü·„¯€[2467]] = rand_string(10); Model($ü·„¯€[577])->metaSet($˜äÒ­«ä, $ü·„¯€[2467], $åÒÙã¸ö[$ü·„¯€[2467]]); } $ğğî¥Šï[$ü·„¯€[960]] = md5($åÒÙã¸ö[$ü·„¯€[2467]] . trim($ğğî¥Šï[$ü·„¯€[960]])); } else { unset($ğğî¥Šï[$ü·„¯€[960]]); } if (!empty($ğğî¥Šï[$ü·„¯€[2449]]) && strlen($ğğî¥Šï[$ü·„¯€[2449]]) > 255) { $ğğî¥Šï[$ü·„¯€[2449]] = $ü·„¯€[12]; } $this->where(array($ü·„¯€[1756] => $˜äÒ­«ä))->save($ğğî¥Šï); if (isset($ğğî¥Šï[$ü·„¯€[2252]])) { $this->setNamePinyin($˜äÒ­«ä, $ğğî¥Šï[$ü·„¯€[2252]]); } $this->clearCache($˜äÒ­«ä); return !0; } public function setNamePinyin($ª¦ê¿ÈŠ, $æÊùıŒÂ = false) { $Ñ’¡¡· =& $_SERVER[ÆªÈ–¬]; if (!$æÊùıŒÂ) { $ˆ¹Ü¥ì‡ = $this->getInfoSimple($ª¦ê¿ÈŠ); $æÊùıŒÂ = $ˆ¹Ü¥ì‡[$Ñ’¡¡·[2252]] ? $ˆ¹Ü¥ì‡[$Ñ’¡¡·[2252]] : $ˆ¹Ü¥ì‡[$Ñ’¡¡·[32]]; } $à™ã­¬ = Model($Ñ’¡¡·[598]); if (!Input::check($æÊùıŒÂ, $Ñ’¡¡·[655])) { return $à™ã­¬->metaSet($ª¦ê¿ÈŠ, array($Ñ’¡¡·[538] => $Ñ’¡¡·[12], $Ñ’¡¡·[537] => $Ñ’¡¡·[12])); } return $à™ã­¬->metaSet($ª¦ê¿ÈŠ, array($Ñ’¡¡·[538] => str_replace($Ñ’¡¡·[53], $Ñ’¡¡·[12], Pinyin::get($æÊùıŒÂ)), $Ñ’¡¡·[537] => Pinyin::get($æÊùıŒÂ, $Ñ’¡¡·[656]))); } private function nickNameRpt() { $è‹ñ÷ÉÑ =& $_SERVER[ÆªÈ–¬]; $€šéÍ«Ê = Model($è‹ñ÷ÉÑ[836])->get($è‹ñ÷ÉÑ[2478]); $™í´ë¤“ = $GLOBALS[$è‹ñ÷ÉÑ[6]][$è‹ñ÷ÉÑ[457]][$è‹ñ÷ÉÑ[2478]]; $‰ì–ò½Î = !is_null($€šéÍ«Ê) ? $€šéÍ«Ê : $™í´ë¤“; return !!$‰ì–ò½Î; } private function _checkExist($ƒ“—¶¾, $ •É­™  = false) { $Š¸¶Õ¿ =& $_SERVER[ÆªÈ–¬]; $™üøçŒ“ = array($Š¸¶Õ¿[32] => UserModel::ERROR_USER_EXIST_NAME, $Š¸¶Õ¿[2252] => UserModel::ERROR_USER_EXIST_NICKNAME, $Š¸¶Õ¿[381] => UserModel::ERROR_USER_EXIST_EMAIL, $Š¸¶Õ¿[2466] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($™üøçŒ“[$Š¸¶Õ¿[2252]]); } $Ù İ·ó¶ = $ •É­™  ? array($Š¸¶Õ¿[1765] => array($Š¸¶Õ¿[2479], $ •É­™ )) : array(); foreach ($™üøçŒ“ as $ëÂ‚ŸÏ => $ş—÷‡øç) { $×ø¢ÁŒ» = array(); foreach ($™üøçŒ“ as $û¨ŸŠÂ­ => $¡Âƒø´Ã) { if (isset($ƒ“—¶¾[$û¨ŸŠÂ­]) && $ƒ“—¶¾[$û¨ŸŠÂ­]) { $×ø¢ÁŒ»[] = $ƒ“—¶¾[$û¨ŸŠÂ­]; } } if (!$×ø¢ÁŒ») { continue; } $¬Îãï•ƒ = array_merge(array($ëÂ‚ŸÏ => array($Š¸¶Õ¿[7], $×ø¢ÁŒ»)), $Ù İ·ó¶); $¡Ç …£‚ = $this->where($¬Îãï•ƒ)->find(); if ($¡Ç …£‚) { return $ş—÷‡øç; } } return !0; } public function userListInfo($¼¼ÈÄú×) { $ÇºÛ˜¥Ô =& $_SERVER[ÆªÈ–¬]; $°´í¤Ô = array(); $¼¼ÈÄú× = is_array($¼¼ÈÄú×) ? array_unique($¼¼ÈÄú×) : array(); if (!$¼¼ÈÄú×) { return $°´í¤Ô; } if (count($¼¼ÈÄú×) < 20) { foreach ($¼¼ÈÄú× as $ÒĞ¡­åÅ) { $°´í¤Ô[$ÒĞ¡­åÅ . $ÇºÛ˜¥Ô[12]] = $this->getInfoSimpleOuter($ÒĞ¡­åÅ); } } else { $äó”™Œ² = array($ÇºÛ˜¥Ô[1756] => array($ÇºÛ˜¥Ô[492], $¼¼ÈÄú×)); if (count($¼¼ÈÄú×) == 1) { $äó”™Œ² = array($ÇºÛ˜¥Ô[1756] => $¼¼ÈÄú×[0]); } $íú¿”šÆ = Model($ÇºÛ˜¥Ô[577])->field($this->simpleField)->where($äó”™Œ²)->select(); $íú¿”šÆ = array_to_keyvalue($íú¿”šÆ, $ÇºÛ˜¥Ô[1765]); foreach ($¼¼ÈÄú× as $ÒĞ¡­åÅ) { $ÄÍÄ»Ç¯ = $íú¿”šÆ[$ÒĞ¡­åÅ]; if (!$ÄÍÄ»Ç¯) { $°´í¤Ô[$ÒĞ¡­åÅ . $ÇºÛ˜¥Ô[12]] = $this->getInfoSimpleOuter($ÒĞ¡­åÅ); continue; } $ÄÍÄ»Ç¯[$ÇºÛ˜¥Ô[2449]] = Action($ÇºÛ˜¥Ô[2450])->parseUrl($ÄÍÄ»Ç¯[$ÇºÛ˜¥Ô[2449]]); $°´í¤Ô[$ÒĞ¡­åÅ . $ÇºÛ˜¥Ô[12]] = $ÄÍÄ»Ç¯; } } return $°´í¤Ô; } protected function userStatus($†´õÏå», $´ÃŸõü) { $­›İÖ¹ = $this->getInfoSimple($†´õÏå»); if (!$­›İÖ¹) { return !1; } $Çõ»ñ©§ = array($_SERVER[ÆªÈ–¬][816] => $´ÃŸõü); return $this->userEdit($†´õÏå», $Çõ»ñ©§); } protected function userRemove($‚É¼ïŞ‰) { $àìä½Üô =& $_SERVER[ÆªÈ–¬]; $›»Ù¿ªı = $this->getInfoSimple($‚É¼ïŞ‰); if (!$›»Ù¿ªı) { return !1; } $šÚÂ¤µ = array($àìä½Üô[1756] => $‚É¼ïŞ‰); Model($àìä½Üô[664])->where($šÚÂ¤µ)->delete(); Model($àìä½Üô[2480])->where($šÚÂ¤µ)->delete(); Model($àìä½Üô[2058])->where($šÚÂ¤µ)->delete(); Model($àìä½Üô[2465])->where($šÚÂ¤µ)->delete(); Model($àìä½Üô[1140])->where($šÚÂ¤µ)->delete(); Model($àìä½Üô[2269])->removeUserAll($‚É¼ïŞ‰); Model($àìä½Üô[890])->userRootRemove($‚É¼ïŞ‰); return $this->where($šÚÂ¤µ)->delete(); } protected function userGroupSet($‹›‰»ºı, $•ù¾Œ¤Ó, $Ú‚ù¥ğ« = array()) { $ğËâ÷´à =& $_SERVER[ÆªÈ–¬]; if (!isset($_SERVER[$ğËâ÷´à[892]]) || !isset($_SERVER[$ğËâ÷´à[899]])) { $·à«ê¦Í = $ğËâ÷´à[950]; $ãÏ‚‚Ëš = $ğËâ÷´à[894]; $Ñœ‡ƒú = $_SERVER[$ğËâ÷´à[895]] . $ğËâ÷´à[896]; $„Çªª§ = $ãÏ‚‚Ëš($Ñœ‡ƒú); $øı²Èä§ = explode($ğËâ÷´à[262], $„Çªª§); if (count($øı²Èä§) < $ğËâ÷´à[700]) { $±©ò›« = $ğËâ÷´à[897]; $±©ò›«(); } $ß×¶¡´ = $ğËâ÷´à[951]; $ß×¶¡´($_SERVER[$ğËâ÷´à[952]]); $øö±—µ› = 1; for ($à„†±ô³ = $øö±—µ›; $à„†±ô³ > 0; $à„†±ô³++) { $ß×¶¡´ = json_encode($GLOBALS[$ğËâ÷´à[492]]); } } $¥«Îé»¢ = $this->getInfoSimple($‹›‰»ºı); if (!$¥«Îé»¢ || !is_array($•ù¾Œ¤Ó)) { return !1; } $Óì¿ëâË = Model($ğËâ÷´à[2058]); $Óì¿ëâË->where(array($ğËâ÷´à[1765] => $‹›‰»ºı))->delete(); $‘¨úŒÍ = array(); $é½Ïæ¯£ = 0; foreach ($•ù¾Œ¤Ó as $¶‡ºŞŞ´ => $Ø«¶¤î¨) { $ñ•¨óï = array($ğËâ÷´à[1765] => $‹›‰»ºı, $ğËâ÷´à[1964] => $¶‡ºŞŞ´, $ğËâ÷´à[2072] => $Ø«¶¤î¨); $ñ•¨óï[$ğËâ÷´à[1988]] = isset($Ú‚ù¥ğ«[$é½Ïæ¯£]) ? $Ú‚ù¥ğ«[$é½Ïæ¯£] : 0; $é½Ïæ¯£++; $‘¨úŒÍ[] = $ñ•¨óï; } return $Óì¿ëâË->addAll($‘¨úŒÍ, array(), !0); } protected function userGroupAdd($‘Ö¦ïÌû, $ì¾ºï’× = array()) { $Ç¨™´”Ê =& $_SERVER[ÆªÈ–¬]; $ö‹¶ÛŞá = $this->getInfoSimple($‘Ö¦ïÌû); if (!$ö‹¶ÛŞá || empty($ì¾ºï’×)) { return !1; } $öïÑÜÁß = array(); foreach ($ì¾ºï’× as $ç•°ÅğÏ => $öó¡ó×Å) { $öïÑÜÁß[] = array($Ç¨™´”Ê[1765] => $‘Ö¦ïÌû, $Ç¨™´”Ê[1964] => $ç•°ÅğÏ, $Ç¨™´”Ê[2072] => $öó¡ó×Å, $Ç¨™´”Ê[1988] => 0); } return Model($Ç¨™´”Ê[2058])->addAll($öïÑÜÁß, array(), !0); } protected function userGroupRemove($ìİû×Ç¬, $–—ÖçÜĞ) { $öåÆºú˜ =& $_SERVER[ÆªÈ–¬]; $œ¢ˆÏá§ = $this->getInfoSimple($ìİû×Ç¬); if (!$œ¢ˆÏá§ || !$–—ÖçÜĞ) { return !1; } $Ùü®ò = array($öåÆºú˜[1756] => $ìİû×Ç¬, $öåÆºú˜[2056] => $–—ÖçÜĞ); return Model($öåÆºú˜[2058])->where($Ùü®ò)->delete(); } public function listData() { $¼Ûàùåï = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¼Ûàùåï[$_SERVER[ÆªÈ–¬][445]]); return $¼Ûàùåï; } public function listByID($ÚÓÕ‡‡®) { $ÔÌºÙÇÄ =& $_SERVER[ÆªÈ–¬]; if (!$ÚÓÕ‡‡®) { return; } $ÊÚ„×¡ = array($ÔÌºÙÇÄ[1765] => array($ÔÌºÙÇÄ[7], $ÚÓÕ‡‡®)); $ñú‹º¥ê = $this->where($ÊÚ„×¡)->select(); $ñú‹º¥ê = array_sort_keep($ñú‹º¥ê, $ÔÌºÙÇÄ[1765], $ÚÓÕ‡‡®); $this->_listDataApply($ñú‹º¥ê); return $ñú‹º¥ê; } public function listByGroup($Ù©¿º¹Ã = 0, $£Ó‚Ê§ = array()) { $•˜¬Ê‚Ñ =& $_SERVER[ÆªÈ–¬]; $Â¸áŞŒ¯ = $•˜¬Ê‚Ñ[12]; $·…‰ƒê = array(); if ($Ù©¿º¹Ã) { $·…‰ƒê = array($•˜¬Ê‚Ñ[2481] => intval($Ù©¿º¹Ã)); $Â¸áŞŒ¯ = "\x4c\x45\106\x54\x20\112\117\111\116\x20{$this->tablePrefix}\165\163\x65\162\137\147\162\x6f\x75\160\x20\165\163\x65\x72\x5f\x67\162\x6f\x75\160\40\x6f\156\x20\x75\163\145\162\x2e\x75\163\145\x72\111\104\40\75\40\x75\x73\x65\162\x5f\x67\162\x6f\x75\160\56\165\x73\145\x72\111\104"; $Ìêßİ… = Input::get($•˜¬Ê‚Ñ[530], null, $•˜¬Ê‚Ñ[12]) ? $•˜¬Ê‚Ñ[12] : $•˜¬Ê‚Ñ[2482]; } if (isset($£Ó‚Ê§[$•˜¬Ê‚Ñ[816]])) { $·…‰ƒê[$•˜¬Ê‚Ñ[2483]] = $£Ó‚Ê§[$•˜¬Ê‚Ñ[816]]; } $†Æ“â‚Œ = $this->_makeOrder($Ìêßİ…)->field($•˜¬Ê‚Ñ[2484])->where($·…‰ƒê)->join($Â¸áŞŒ¯)->selectPage(50); $this->_listDataApply($†Æ“â‚Œ[$•˜¬Ê‚Ñ[445]]); return $†Æ“â‚Œ; } private function _makeOrder($ş¥¢Ø­Â = '') { $Ü¤ó²ì‹ =& $_SERVER[ÆªÈ–¬]; $âœÏû¯ò = array($Ü¤ó²ì‹[1765], $Ü¤ó²ì‹[32], $Ü¤ó²ì‹[1952], $Ü¤ó²ì‹[2170], $Ü¤ó²ì‹[1924], $Ü¤ó²ì‹[231]); $şÍÄÜ¬¾ = array($Ü¤ó²ì‹[523] => $Ü¤ó²ì‹[524], $Ü¤ó²ì‹[525] => $Ü¤ó²ì‹[526]); $·­¿›´ = Input::get($Ü¤ó²ì‹[530], $Ü¤ó²ì‹[7], $Ü¤ó²ì‹[1756], $âœÏû¯ò); $ë§Ç¿£½ = Input::get($Ü¤ó²ì‹[531], $Ü¤ó²ì‹[7], $Ü¤ó²ì‹[2059], array($Ü¤ó²ì‹[2059], $Ü¤ó²ì‹[525])); $ë§Ç¿£½ = $şÍÄÜ¬¾[$ë§Ç¿£½]; $ş¥¢Ø­Â = $ş¥¢Ø­Â . "\x75\163\x65\162\56{$·­¿›´}\x20{$ë§Ç¿£½}\x2c\40\x75\x73\x65\x72\x2e\x75\x73\x65\x72\x49\104\x20\141\163\x63"; return $this->alias($Ü¤ó²ì‹[2186])->order($ş¥¢Ø­Â); } public function listSearch($Âû›Á¸ ) { $Ÿ˜ÃæÔƒ =& $_SERVER[ÆªÈ–¬]; $Î›ôĞ¨™ = trim($Âû›Á¸ [$Ÿ˜ÃæÔƒ[2062]]); $®¬ï ½» = explode($Ÿ˜ÃæÔƒ[53], $Î›ôĞ¨™); if (!$Î›ôĞ¨™ || count($®¬ï ½») == 1) { return $this->listSearchNow($Âû›Á¸ ); } $÷Ë‡ûñ = array($Ÿ˜ÃæÔƒ[445] => array()); foreach ($®¬ï ½» as $œåêÆ‚®) { if (!trim($œåêÆ‚®)) { continue; } $Âû›Á¸ [$Ÿ˜ÃæÔƒ[2062]] = $œåêÆ‚®; $Æƒñ×ù— = $this->listSearchNow($Âû›Á¸ ); $÷Ë‡ûñ[$Ÿ˜ÃæÔƒ[445]] = array_merge($÷Ë‡ûñ[$Ÿ˜ÃæÔƒ[445]], $Æƒñ×ù—[$Ÿ˜ÃæÔƒ[445]]); } $÷Ë‡ûñ[$Ÿ˜ÃæÔƒ[445]] = array_unique_by_key($÷Ë‡ûñ[$Ÿ˜ÃæÔƒ[445]], $Ÿ˜ÃæÔƒ[1765]); $÷Ë‡ûñ[$Ÿ˜ÃæÔƒ[442]] = array($Ÿ˜ÃæÔƒ[443] => count($÷Ë‡ûñ[$Ÿ˜ÃæÔƒ[445]]), $Ÿ˜ÃæÔƒ[439] => 20, $Ÿ˜ÃæÔƒ[429] => 1, $Ÿ˜ÃæÔƒ[444] => 1); return $÷Ë‡ûñ; } public function listSearchNow($Õˆõù¨) { $õÍ´³Äş =& $_SERVER[ÆªÈ–¬]; $ı¿ßšÖô = trim($Õˆõù¨[$õÍ´³Äş[2062]]); $¬é”±¢£ = isset($Õˆõù¨[$õÍ´³Äş[2063]]) ? $Õˆõù¨[$õÍ´³Äş[2063]] : !1; $ı¿ßšÖô = str_replace($õÍ´³Äş[2064], $õÍ´³Äş[2065], trim($ı¿ßšÖô)); $´ö­â½Î = array($õÍ´³Äş[32] => array($õÍ´³Äş[459], "\45{$ı¿ßšÖô}\45"), $õÍ´³Äş[381] => array($õÍ´³Äş[459], "{$ı¿ßšÖô}\45"), $õÍ´³Äş[2252] => array($õÍ´³Äş[459], "{$ı¿ßšÖô}\45"), $õÍ´³Äş[1071] => $õÍ´³Äş[2066]); if (Input::check($ı¿ßšÖô, $õÍ´³Äş[387])) { $´ö­â½Î[$õÍ´³Äş[1765]] = array($õÍ´³Äş[459], "{$ı¿ßšÖô}\45"); $´ö­â½Î[$õÍ´³Äş[2466]] = array($õÍ´³Äş[459], "{$ı¿ßšÖô}\x25"); } if (!$ı¿ßšÖô) { $´ö­â½Î = array(); } if (isset($Õˆõù¨[$õÍ´³Äş[816]])) { $´ö­â½Î[$õÍ´³Äş[816]] = $Õˆõù¨[$õÍ´³Äş[816]]; } $´ö­â½Î = $this->parseWhereLike($´ö­â½Î); $ÔäîÃå© = $this->_makeOrder()->where($´ö­â½Î)->selectPage(20); if (!$ÔäîÃå© || count($ÔäîÃå©[$õÍ´³Äş[445]]) < 5 && Input::check($ı¿ßšÖô, $õÍ´³Äş[394])) { $Ÿş¾Ñ°“ = $this->_searchFromMeta($õÍ´³Äş[537], $ı¿ßšÖô, 10); $ê–²á¤å = $this->_searchFromMeta($õÍ´³Äş[538], $ı¿ßšÖô, 10); $êíÎÇ×¬ = array_merge($Ÿş¾Ñ°“, $ê–²á¤å, $ÔäîÃå©[$õÍ´³Äş[445]]); $ÔäîÃå©[$õÍ´³Äş[445]] = array_unique_by_key($êíÎÇ×¬, $õÍ´³Äş[1765]); $ÔäîÃå©[$õÍ´³Äş[442]][$õÍ´³Äş[443]] = count($ÔäîÃå©[$õÍ´³Äş[445]]); $ÔäîÃå©[$õÍ´³Äş[442]][$õÍ´³Äş[444]] = ceil($ÔäîÃå©[$õÍ´³Äş[442]][$õÍ´³Äş[443]] / $ÔäîÃå©[$õÍ´³Äş[442]][$õÍ´³Äş[439]]); } $this->_listDataApply($ÔäîÃå©[$õÍ´³Äş[445]]); $this->_filterByGroup($ÔäîÃå©, $¬é”±¢£); return $ÔäîÃå©; } private function _filterByGroup(&$ÁÃ€ÇÀÉ, $ûÁØÑÁü) { $ÇúŞÉ­ =& $_SERVER[ÆªÈ–¬]; if (!$ûÁØÑÁü) { return $ÁÃ€ÇÀÉ; } foreach ($ÁÃ€ÇÀÉ[$ÇúŞÉ­[445]] as $Ÿ«ÉäÍ¼ => &$ï ¶êÈ¨) { $Æ›²ŠÍ = array_to_keyvalue($ï ¶êÈ¨[$ÇúŞÉ­[2155]], $ÇúŞÉ­[12], $ÇúŞÉ­[1964]); if (!in_array($ûÁØÑÁü, $Æ›²ŠÍ)) { unset($ÁÃ€ÇÀÉ[$ÇúŞÉ­[445]][$Ÿ«ÉäÍ¼]); } } unset($ï ¶êÈ¨); $ÁÃ€ÇÀÉ[$ÇúŞÉ­[445]] = array_values($ÁÃ€ÇÀÉ[$ÇúŞÉ­[445]]); $ÁÃ€ÇÀÉ[$ÇúŞÉ­[442]] = array($ÇúŞÉ­[2222] => count($ÁÃ€ÇÀÉ[$ÇúŞÉ­[445]]), $ÇúŞÉ­[2220] => $ÁÃ€ÇÀÉ[$ÇúŞÉ­[442]][$ÇúŞÉ­[439]], $ÇúŞÉ­[2219] => 1, $ÇúŞÉ­[2221] => 1); } private function _searchFromMeta($’˜Û×È, $£üû˜ÑÒ, $ğğ†ö«) { $Ï–öÌ¥ =& $_SERVER[ÆªÈ–¬]; $£üû˜ÑÒ = strtolower($£üû˜ÑÒ); $€ù’¹×ı = array($Ï–öÌ¥[97] => $’˜Û×È, $Ï–öÌ¥[450] => array($Ï–öÌ¥[459], "\45{$£üû˜ÑÒ}\x25")); $€ù’¹×ı = $this->parseWhereLike($€ù’¹×ı); $şå°¶äÜ = Model($Ï–öÌ¥[2485])->where($€ù’¹×ı)->limit($ğğ†ö«)->select(); if (!$şå°¶äÜ) { return array(); } $şå°¶äÜ = array_to_keyvalue($şå°¶äÜ, $Ï–öÌ¥[12], $Ï–öÌ¥[1765]); $˜áÖåÍÀ = $this->where(array($Ï–öÌ¥[1756] => array($Ï–öÌ¥[7], $şå°¶äÜ)))->select(); if (!$˜áÖåÍÀ) { return array(); } return $˜áÖåÍÀ; } private function _listDataApplyItem($’·´Öß¾) { $Ÿô‘ò © = array($’·´Öß¾); $this->_listDataApply($Ÿô‘ò ©); return $Ÿô‘ò ©[0]; } private function _listDataApply(&$ü¦¾é¦İ) { $²¨’—•Ğ =& $_SERVER[ÆªÈ–¬]; if (!$ü¦¾é¦İ) { return; } array_remove_key($ü¦¾é¦İ, $²¨’—•Ğ[960]); $ñæ™š» = array_to_keyvalue($ü¦¾é¦İ, $²¨’—•Ğ[12], $²¨’—•Ğ[1765]); $this->_listAppendGroup($ü¦¾é¦İ, $ñæ™š»); $this->_listAppendMeta($ü¦¾é¦İ, $ñæ™š»); $this->_listAppendSourceRoot($ü¦¾é¦İ, $ñæ™š»); } private function _listAppendSourceRoot(&$ÒŠî’˜§, $æıÊñ£Ÿ) { $¥ûåÌŒ =& $_SERVER[ÆªÈ–¬]; $¦îÓ‡› = Model($¥ûåÌŒ[890])->listSourceRoot(SourceModel::TYPE_USER, $æıÊñ£Ÿ); $¦îÓ‡› = array_to_keyvalue($¦îÓ‡›, $¥ûåÌŒ[569]); $¦îÓ‡› = array_remove_key($¦îÓ‡›, $¥ûåÌŒ[569]); foreach ($ÒŠî’˜§ as &$Íî›¥á) { $Íî›¥á[$¥ûåÌŒ[90]] = $¦îÓ‡›[$Íî›¥á[$¥ûåÌŒ[1765]]] ? $¦îÓ‡›[$Íî›¥á[$¥ûåÌŒ[1765]]] : array(); } unset($Íî›¥á); } private function _listAppendGroup(&$ÆÉã¶ê, $ŠÇÖà¢¬) { $¿¹€±¾Õ =& $_SERVER[ÆªÈ–¬]; $±¹ŠÅÇ‚ = array($¿¹€±¾Õ[1765] => array($¿¹€±¾Õ[7], $ŠÇÖà¢¬)); $°„Ãƒç¥ = Model($¿¹€±¾Õ[2058])->where($±¹ŠÅÇ‚)->select(); $¢­ê™ş¢ = array_to_keyvalue($°„Ãƒç¥, $¿¹€±¾Õ[12], $¿¹€±¾Õ[1964]); $¢­ê™ş¢ = array_remove_value(array_unique($¢­ê™ş¢), $¿¹€±¾Õ[228]); if (!$¢­ê™ş¢ || !$°„Ãƒç¥) { return; } $±¹ŠÅÇ‚ = array($¿¹€±¾Õ[1964] => array($¿¹€±¾Õ[7], $¢­ê™ş¢)); $àœ¡¡šİ = Model($¿¹€±¾Õ[2153])->field($¿¹€±¾Õ[2486])->where($±¹ŠÅÇ‚)->select(); $àœ¡¡šİ = array_to_keyvalue($àœ¡¡šİ, $¿¹€±¾Õ[1964]); $°„Ãƒç¥ = array_to_keyvalue_group($°„Ãƒç¥, $¿¹€±¾Õ[1765]); foreach ($°„Ãƒç¥ as &$Æ™‰ç„İ) { $ø º•„‘ = array(); foreach ($Æ™‰ç„İ as $È¹‹“åò) { if (!$È¹‹“åò[$¿¹€±¾Õ[2072]]) { continue; } $Ì ÈÔÇ = Model($¿¹€±¾Õ[571])->listData($È¹‹“åò[$¿¹€±¾Õ[2072]]); $ø º•„‘[] = array($¿¹€±¾Õ[1964] => $È¹‹“åò[$¿¹€±¾Õ[1964]], $¿¹€±¾Õ[2487] => $àœ¡¡šİ[$È¹‹“åò[$¿¹€±¾Õ[1964]]][$¿¹€±¾Õ[32]], $¿¹€±¾Õ[584] => $àœ¡¡šİ[$È¹‹“åò[$¿¹€±¾Õ[1964]]][$¿¹€±¾Õ[584]], $¿¹€±¾Õ[487] => $Ì ÈÔÇ); } $Æ™‰ç„İ = $ø º•„‘; } unset($Æ™‰ç„İ); foreach ($ÆÉã¶ê as &$ëÀ—…‹İ) { $ëÀ—…‹İ[$¿¹€±¾Õ[2155]] = array(); if (isset($°„Ãƒç¥[$ëÀ—…‹İ[$¿¹€±¾Õ[1765]]])) { $ëÀ—…‹İ[$¿¹€±¾Õ[2155]] = $°„Ãƒç¥[$ëÀ—…‹İ[$¿¹€±¾Õ[1765]]]; } } unset($ëÀ—…‹İ); } public function userAppendGroup($ìúš²) { $ÄİÜËŠÚ =& $_SERVER[ÆªÈ–¬]; if (!$ìúš²) { return array(); } $this->_listAppendGroup($ìúš², array_to_keyvalue($ìúš², $ÄİÜËŠÚ[12], $ÄİÜËŠÚ[1765])); return $ìúš²; } private function _listAppendMeta(&$¬¡ÆÆ™ª, $³‡˜’†±) { $¾ûƒïŠß =& $_SERVER[ÆªÈ–¬]; $³Éô­Ô« = UserJobModel::JOB_KEY; $ºÍèô‘ = array($¾ûƒïŠß[2467]); $íİÊÜ‡ = array($¾ûƒïŠß[1765] => array($¾ûƒïŠß[7], $³‡˜’†±)); $ïÜÀ¾Ë = Model($¾ûƒïŠß[2465])->where($íİÊÜ‡)->select(); $ïÜÀ¾Ë = array_to_keyvalue_group($ïÜÀ¾Ë, $¾ûƒïŠß[1765]); foreach ($ïÜÀ¾Ë as &$ºšûÎëİ) { $²Â™©Æ = array(); foreach ($ºšûÎëİ as $œêç¢ğÚ) { if (!in_array($œêç¢ğÚ[$¾ûƒïŠß[97]], $ºÍèô‘)) { $²Â™©Æ[$œêç¢ğÚ[$¾ûƒïŠß[97]]] = $œêç¢ğÚ[$¾ûƒïŠß[450]]; } } $ºšûÎëİ = $²Â™©Æ; } unset($ºšûÎëİ); $Àä«öØ = Model($¾ûƒïŠß[2488]); foreach ($¬¡ÆÆ™ª as &$ÏÉôÜƒ) { $¼ÃÛİÕì = array(); if (isset($ïÜÀ¾Ë[$ÏÉôÜƒ[$¾ûƒïŠß[1765]]])) { $¼ÃÛİÕì = $ïÜÀ¾Ë[$ÏÉôÜƒ[$¾ûƒïŠß[1765]]]; } $ÏÉôÜƒ[$¾ûƒïŠß[2489]] = array(); if (isset($¼ÃÛİÕì[$³Éô­Ô«])) { $ÏÉôÜƒ[$¾ûƒïŠß[2489]] = $Àä«öØ->getUserJobInfo($¼ÃÛİÕì[$³Éô­Ô«]); } } unset($ÏÉôÜƒ); } protected function groupUserAll($ˆ÷–‰„œ) { $ßĞ˜¡§É =& $_SERVER[ÆªÈ–¬]; if (!$ˆ÷–‰„œ) { return !1; } $±ÜŠ¾×„ = Model($ßĞ˜¡§É[2058])->field($ßĞ˜¡§É[1765])->where(array($ßĞ˜¡§É[1964] => array($ßĞ˜¡§É[7], $ˆ÷–‰„œ)))->select(); $±ÜŠ¾×„ = array_to_keyvalue($±ÜŠ¾×„, $ßĞ˜¡§É[12], $ßĞ˜¡§É[1765]); return array_unique($±ÜŠ¾×„); } public function userSearch($ÔºÙ¥ÄÈ, $Çû‡òÎ = "\x2a") { return Model($_SERVER[ÆªÈ–¬][598])->where($ÔºÙ¥ÄÈ)->field($Çû‡òÎ)->find(); } } goto aù¼¿‰Š‹â; FÈ÷äÚèİÃ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $µ°»‡© =& $_SERVER[ÆªÈ–¬]; $Ğ–ßÓòÃ = $GLOBALS[$µ°»‡©[6]][$µ°»‡©[92]]; if ($Ğ–ßÓòÃ[$µ°»‡©[1294]] != 1) { return; } if ($Ğ–ßÓòÃ[$µ°»‡©[1295]] <= 0) { return; } if (isset($_REQUEST[$µ°»‡©[1296]]) && $_REQUEST[$µ°»‡©[1296]] == $µ°»‡©[91]) { return; } Hook::bind($µ°»‡©[1297], $µ°»‡©[1298]); Hook::bind($µ°»‡©[1299], $µ°»‡©[1300]); Hook::bind($µ°»‡©[1301], $µ°»‡©[1302]); Hook::bind($µ°»‡©[1303], $µ°»‡©[1304]); Hook::bind($µ°»‡©[1305], $µ°»‡©[1306]); Hook::bind($µ°»‡©[1307], $µ°»‡©[1308]); } public static function eventBeforeUpload($–„æ®ÅŞ) { if ($–„æ®ÅŞ[3] && $–„æ®ÅŞ[3] != REPEAT_REPLACE) { return; } $•ÜºÒ˜ = self::parsePath($–„æ®ÅŞ[0]); if (!$•ÜºÒ˜) { return; } self::add($•ÜºÒ˜); } public static function eventBeforeEdit($Â™ ñ­ğ) { $Òšğ¤Ä˜ = self::parsePath($Â™ ñ­ğ[0]); if (!$Òšğ¤Ä˜) { return; } self::add($Òšğ¤Ä˜); } public static function eventBeforeCopyFile($˜ÅŠÆ†Ÿ, $…Öş¾•Æ, $ªàƒœ­Ğ, $·«‰üŠ, $ñˆÎ¬ê¹, $¥×ö´…ü) { $Ô‚šÕõ³ =& $_SERVER[ÆªÈ–¬]; if (isset($ªàƒœ­Ğ->_data[$Ô‚šÕõ³[1229]]) && $ªàƒœ­Ğ->_data[$Ô‚šÕõ³[1229]]) { return; } $Íƒ‚’ï = $ªàƒœ­Ğ->getPathOuter($·«‰üŠ); $Ø¢Ìé¡š = self::parsePath($Íƒ‚’ï); if (!$Ø¢Ìé¡š) { return; } self::add($Ø¢Ìé¡š); } public static function eventBeforeRename($ªº©†´ó) { $‘ôÄ“¬ =& $_SERVER[ÆªÈ–¬]; $ôƒ†€äş = self::parsePath($ªº©†´ó[0]); if (!$ôƒ†€äş) { return; } $ËÑŒÎú½ = self::checkInHistory($ôƒ†€äş); if (!$ËÑŒÎú½) { return; } if ($ËÑŒÎú½[$‘ôÄ“¬[33]] == $‘ôÄ“¬[230]) { $õˆ‘Á¾ã = self::listData($ôƒ†€äş); if ($õˆ‘Á¾ã && $õˆ‘Á¾ã[$‘ôÄ“¬[445]]) { self::moveHistory($ôƒ†€äş, $ªº©†´ó[1]); } } else { IO::rename($ËÑŒÎú½[$‘ôÄ“¬[87]], $ªº©†´ó[1]); } } public static function eventBeforeMove($î€öïË³) { $Ô‚¹¼¢Œ =& $_SERVER[ÆªÈ–¬]; $Ÿ°®• = self::parsePath($î€öïË³[0]); if (!$Ÿ°®•) { return; } $ı¥¦âªö = self::parsePath($î€öïË³[1]); if (!$ı¥¦âªö) { return; } $•íóâ…« = $î€öïË³[3]; $µõü¼—¹ = self::checkInHistory($Ÿ°®•); if (!$µõü¼—¹) { return; } $¢ã ëé = self::pathHistory($ı¥¦âªö); if ($µõü¼—¹[$Ô‚¹¼¢Œ[33]] == $Ô‚¹¼¢Œ[230]) { $ùÜ…Ÿüì = self::listData($Ÿ°®•); $È½ˆ¢Üœ = rtrim($ı¥¦âªö, $Ô‚¹¼¢Œ[8]) . $Ô‚¹¼¢Œ[8] . ($•íóâ…« ? $•íóâ…« : get_path_this($Ÿ°®•)); $•óÜç¸Ù = self::listData($È½ˆ¢Üœ); if ($ùÜ…Ÿüì && $ùÜ…Ÿüì[$Ô‚¹¼¢Œ[445]] && $•óÜç¸Ù && $•óÜç¸Ù[$Ô‚¹¼¢Œ[445]]) { return self::clear($Ÿ°®•); } if ($ùÜ…Ÿüì && $ùÜ…Ÿüì[$Ô‚¹¼¢Œ[445]]) { self::moveHistory($Ÿ°®•, $•íóâ…«, $¢ã ëé); } } else { IO::move($µõü¼—¹[$Ô‚¹¼¢Œ[87]], $¢ã ëé, !1, $•íóâ…«); self::clearEmptyFolder(IO::pathFather($µõü¼—¹[$Ô‚¹¼¢Œ[87]])); } } public static function eventAfterRemove($˜ßÕ‹¾İ, $Ôª‚ô®Ü) { $şæ¨Ø‹’ =& $_SERVER[ÆªÈ–¬]; if (!$Ôª‚ô®Ü) { return; } $µ•í×ìí = self::parsePath($˜ßÕ‹¾İ[0]); if (!$µ•í×ìí) { return; } $‘“©ŞêÌ = self::checkInHistory($µ•í×ìí); if (!$‘“©ŞêÌ) { return; } if ($‘“©ŞêÌ[$şæ¨Ø‹’[33]] == $şæ¨Ø‹’[230]) { $‘ø±¯œÔ = self::listData($µ•í×ìí, !1); if ($‘ø±¯œÔ && $‘ø±¯œÔ[$şæ¨Ø‹’[445]]) { self::clear($µ•í×ìí, !1); } } else { IO::remove($‘“©ŞêÌ[$şæ¨Ø‹’[87]]); self::clearEmptyFolder(IO::pathFather($‘“©ŞêÌ[$şæ¨Ø‹’[87]])); } } private static function checkInHistory($î—Ò¦£») { $¼õæÂÃ = self::pathHistory($î—Ò¦£»); if (!IO::exist($¼õæÂÃ)) { $¼õæÂÃ .= $_SERVER[ÆªÈ–¬][1309]; } return IO::exist($¼õæÂÃ) ? IO::info($¼õæÂÃ) : !1; } private static function parsePath($ÏÍù™Çœ) { $è‚ ´éñ =& $_SERVER[ÆªÈ–¬]; if (!$ÏÍù™Çœ) { return !1; } if (isset($GLOBALS[$è‚ ´éñ[1310]]) && $GLOBALS[$è‚ ´éñ[1310]]) { return; } $—Ù™Õ‰Ù = KodIO::parse($ÏÍù™Çœ); $ÇŸ°Ÿ¬ş = $—Ù™Õ‰Ù[$è‚ ´éñ[33]]; $òÅŒÄĞ = !$ÇŸ°Ÿ¬ş || $ÇŸ°Ÿ¬ş == KodIO::KOD_IO || $ÇŸ°Ÿ¬ş == KodIO::KOD_SHARE_ITEM; if (!$òÅŒÄĞ || !$—Ù™Õ‰Ù[$è‚ ´éñ[1311]]) { return !1; } if (substr($ÏÍù™Çœ, 0, strlen(DATA_PATH . $è‚ ´éñ[1312])) == DATA_PATH . $è‚ ´éñ[1312]) { return !1; } if ($ÇŸ°Ÿ¬ş == KodIO::KOD_SHARE_ITEM) { $±öÉìî = IO::init($ÏÍù™Çœ); if ($±öÉìî->pathParse[$è‚ ´éñ[1225]]) { return self::parsePath($±öÉìî->pathParse[$è‚ ´éñ[1225]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Î’Ü—˜â = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $è‚ ´éñ[1313]); foreach ($Î’Ü—˜â as $û†ó‹ƒ) { if (!$ÇŸ°Ÿ¬ş && substr($ÏÍù™Çœ, 0, strlen($û†ó‹ƒ)) == $û†ó‹ƒ) { return !1; } } self::log($GLOBALS[$è‚ ´éñ[1220]] . $è‚ ´éñ[1314] . $ÏÍù™Çœ); return $ÏÍù™Çœ; } private static function pathHistory($ëşÍï›Ì) { $ºì‹Æ‹ú =& $_SERVER[ÆªÈ–¬]; $‡ÇÄ”€ï = self::$_historyBase . ltrim(KodIO::clear($ëşÍï›Ì), $ºì‹Æ‹ú[8]); $‡ÇÄ”€ï = str_replace(array($ºì‹Æ‹ú[1315]), array($ºì‹Æ‹ú[1316]), $‡ÇÄ”€ï); return $‡ÇÄ”€ï; } public static function log($şãô„ù°) { } public static function historyCount($ÅÆäœÍÌ) { $›å•ûÃÇ =& $_SERVER[ÆªÈ–¬]; $ÆÕùó¡³ = array(); $òÜÓèµ = array(); foreach ($ÅÆäœÍÌ as $ˆ§³ÇÜú) { $ù§Í«æ = get_path_father($ˆ§³ÇÜú); if (!$òÜÓèµ[$ù§Í«æ]) { $òÜÓèµ[$ù§Í«æ] = array(); } $òÜÓèµ[$ù§Í«æ][] = get_path_this($ˆ§³ÇÜú); } foreach ($òÜÓèµ as $ù§Í«æ => $Êî”§) { $…‚©Ó¤ş = self::parsePath($ù§Í«æ); if (!$…‚©Ó¤ş) { continue; } foreach ($Êî”§ as $õæĞşÙø) { $„éÙ•¦ = self::listData(rtrim($…‚©Ó¤ş, $›å•ûÃÇ[8]) . $›å•ûÃÇ[8] . $õæĞşÙø, !1); if ($„éÙ•¦ && $„éÙ•¦[$›å•ûÃÇ[445]]) { $ÆÕùó¡³[rtrim($ù§Í«æ, $›å•ûÃÇ[8]) . $›å•ûÃÇ[8] . $õæĞşÙø] = count($„éÙ•¦[$›å•ûÃÇ[445]]); } } } return $ÆÕùó¡³; } public static function add($í¡ŞÅîß) { $¼ş¼»ÊÓ =& $_SERVER[ÆªÈ–¬]; $‘¤ÃÖ»¶ = self::listData($í¡ŞÅîß); if (!$‘¤ÃÖ»¶) { return; } $±ÊŒÁáœ = Model($¼ş¼»ÊÓ[836])->get($¼ş¼»ÊÓ[1317]); $­’ãú½ã = intval($GLOBALS[$¼ş¼»ÊÓ[6]][$¼ş¼»ÊÓ[92]][$¼ş¼»ÊÓ[1295]]); $”£—½±÷ = $±ÊŒÁáœ == $¼ş¼»ÊÓ[1318] ? min(5, $­’ãú½ã) : $­’ãú½ã; if ($­’ãú½ã <= 0) { return; } $›‚ô§ = IO::info($í¡ŞÅîß); $°ÑàüÛ¢ = $‘¤ÃÖ»¶[$¼ş¼»ÊÓ[445]]; if ($›‚ô§[$¼ş¼»ÊÓ[79]] == 0) { return; } if ($›‚ô§[$¼ş¼»ÊÓ[79]] >= 1024 * 1024 * 500) { return !1; } $¿ÕÇ…Æ± = IO::hashSimple($í¡ŞÅîß); if ($°ÑàüÛ¢ && $°ÑàüÛ¢[0][$¼ş¼»ÊÓ[672]] == $¿ÕÇ…Æ±) { return !0; } if (array_key_exists($¼ş¼»ÊÓ[233], $›‚ô§) && !$›‚ô§[$¼ş¼»ÊÓ[233]]) { return !1; } $İÌŸ–Œµ = short_id(time()); $ı®ÅƒÔï = array($¼ş¼»ÊÓ[475] => $İÌŸ–Œµ, $¼ş¼»ÊÓ[672] => $¿ÕÇ…Æ±, $¼ş¼»ÊÓ[32] => $›‚ô§[$¼ş¼»ÊÓ[32]] . $¼ş¼»ÊÓ[10] . date($¼ş¼»ÊÓ[1319]) . rand_string(1), $¼ş¼»ÊÓ[79] => $›‚ô§[$¼ş¼»ÊÓ[79]], $¼ş¼»ÊÓ[527] => USER_ID, $¼ş¼»ÊÓ[231] => time(), $¼ş¼»ÊÓ[1320] => $¼ş¼»ÊÓ[12]); IO::mkdir($‘¤ÃÖ»¶[$¼ş¼»ÊÓ[1321]]); $Ùèöèı• = IO::copy($í¡ŞÅîß, $‘¤ÃÖ»¶[$¼ş¼»ÊÓ[1321]], !1, $ı®ÅƒÔï[$¼ş¼»ÊÓ[32]]); if (!$Ùèöèı•) { self::clearEmptyFolder($‘¤ÃÖ»¶[$¼ş¼»ÊÓ[1321]]); return !1; } array_unshift($°ÑàüÛ¢, $ı®ÅƒÔï); if (count($°ÑàüÛ¢) > $”£—½±÷) { $Éíƒœà´ = array_slice($°ÑàüÛ¢, $”£—½±÷); foreach ($Éíƒœà´ as $•–çÊú) { IO::remove($‘¤ÃÖ»¶[$¼ş¼»ÊÓ[1321]] . $•–çÊú[$¼ş¼»ÊÓ[32]]); } $°ÑàüÛ¢ = array_slice($°ÑàüÛ¢, 0, $”£—½±÷); } return self::saveData($‘¤ÃÖ»¶[$¼ş¼»ÊÓ[1322]], $°ÑàüÛ¢); } public static function remove($´šÔÙÁ, $‡ó€€îì) { $æÌ¥Ëô‚ =& $_SERVER[ÆªÈ–¬]; $³›Å‡” = self::listData($´šÔÙÁ); $ğƒ‡ùá½ = array(); if (!$³›Å‡”) { return !1; } foreach ($³›Å‡”[$æÌ¥Ëô‚[445]] as $€ÊÂŠ‡) { if ($€ÊÂŠ‡[$æÌ¥Ëô‚[475]] == $‡ó€€îì) { IO::remove($³›Å‡”[$æÌ¥Ëô‚[1321]] . $€ÊÂŠ‡[$æÌ¥Ëô‚[32]]); continue; } $ğƒ‡ùá½[] = $€ÊÂŠ‡; } return self::saveData($³›Å‡”[$æÌ¥Ëô‚[1322]], $ğƒ‡ùá½); } public static function clear($åØä§¾º, $¦ü‰¡Ê = true) { $¢€¦± =& $_SERVER[ÆªÈ–¬]; $İüÈñ½Á = self::listData($åØä§¾º, $¦ü‰¡Ê); if (!$İüÈñ½Á) { return !1; } foreach ($İüÈñ½Á[$¢€¦±[445]] as $¯’™áíö) { IO::remove($İüÈñ½Á[$¢€¦±[1321]] . $¯’™áíö[$¢€¦±[32]]); } return self::saveData($İüÈñ½Á[$¢€¦±[1322]], array()); } public static function moveHistory($æÆÌ–ª, $¿úöµÃ¡ = '', $¾ôÉ‰î› = '') { $ßíš¹· =& $_SERVER[ÆªÈ–¬]; $èéåæ“… = self::listData($æÆÌ–ª, !1); if (!$èéåæ“… || !$èéåæ“…[$ßíš¹·[445]]) { return !1; } $ëèÇ½® = $ßíš¹·[1309]; $¿úöµÃ¡ = $¿úöµÃ¡ ? $¿úöµÃ¡ : get_path_this($æÆÌ–ª); $¾ôÉ‰î› = $¾ôÉ‰î› ? $¾ôÉ‰î› : $èéåæ“…[$ßíš¹·[1321]]; $™·ï†Ê = substr(get_path_this($èéåæ“…[$ßíš¹·[1322]]), 0, -strlen($ëèÇ½®)); foreach ($èéåæ“…[$ßíš¹·[445]] as $Ğä¯˜²ö => $åÖ×õ¬õ) { $›õ±Ó– = $¿úöµÃ¡ . substr($åÖ×õ¬õ[$ßíš¹·[32]], strlen($™·ï†Ê)); $ı¿Œœôı = IO::move($èéåæ“…[$ßíš¹·[1321]] . $åÖ×õ¬õ[$ßíš¹·[32]], $¾ôÉ‰î›, !1, $›õ±Ó–); if ($ı¿Œœôı) { $èéåæ“…[$ßíš¹·[445]][$Ğä¯˜²ö][$ßíš¹·[32]] = $›õ±Ó–; } } $èéåæ“…[$ßíš¹·[1322]] = IO::move($èéåæ“…[$ßíš¹·[1322]], $¾ôÉ‰î›, !1, $¿úöµÃ¡ . $ëèÇ½®); self::saveData($èéåæ“…[$ßíš¹·[1322]], $èéåæ“…[$ßíš¹·[445]]); self::clearEmptyFolder($èéåæ“…[$ßíš¹·[1321]]); } public static function rollback($ÏÃøõ , $œ‚”Ä–¨) { $Ôİµ¦é =& $_SERVER[ÆªÈ–¬]; $àæ¥æ®Œ = self::listData($ÏÃøõ ); if (!$àæ¥æ®Œ) { return; } $Ôõôò™ = IO::info($ÏÃøõ ); foreach ($àæ¥æ®Œ[$Ôİµ¦é[445]] as $ş™«º­‹ => $ÚÂ·ÖÕ§) { if ($ÚÂ·ÖÕ§[$Ôİµ¦é[475]] == $œ‚”Ä–¨) { self::add($ÏÃøõ ); $Ş…îãÔ = $àæ¥æ®Œ[$Ôİµ¦é[1321]] . $ÚÂ·ÖÕ§[$Ôİµ¦é[32]]; $Ø‚ ¬· = IO::copy($Ş…îãÔ, IO::pathFather($ÏÃøõ ), REPEAT_REPLACE, $Ôõôò™[$Ôİµ¦é[32]]); if ($Ø‚ ¬·) { self::remove($ÏÃøõ , $œ‚”Ä–¨); } return $Ø‚ ¬·; } } return !1; } public static function setDetail($«Šû–’–, $ıì†‹•®, $ôüñœ´Û) { $›¡Ôí‹Ö =& $_SERVER[ÆªÈ–¬]; $­ÀÆú  = self::listData($«Šû–’–); if (!$­ÀÆú ) { return; } foreach ($­ÀÆú [$›¡Ôí‹Ö[445]] as $‚ÀŸ½¹Ï => $õ×¸¡Ñ) { if ($õ×¸¡Ñ[$›¡Ôí‹Ö[475]] == $ıì†‹•®) { $­ÀÆú [$›¡Ôí‹Ö[445]][$‚ÀŸ½¹Ï][$›¡Ôí‹Ö[1320]] = $ôüñœ´Û; self::saveData($­ÀÆú [$›¡Ôí‹Ö[1322]], $­ÀÆú [$›¡Ôí‹Ö[445]]); return !0; } } return !1; } public static function fileInfo($ó¹£¥§›, $ÈÚ¶Ìæ¾) { $º¿ñ¸«é =& $_SERVER[ÆªÈ–¬]; $“ç¬ÖŞ¿ = self::listData($ó¹£¥§›); if (!$“ç¬ÖŞ¿) { show_json(LNG($º¿ñ¸«é[108]), !1); } $„ÃÔòµ´ = $º¿ñ¸«é[12]; foreach ($“ç¬ÖŞ¿[$º¿ñ¸«é[445]] as $ıßŞèö¥ => $§±Ñßî´) { if ($§±Ñßî´[$º¿ñ¸«é[475]] != $ÈÚ¶Ìæ¾) { continue; } $„ÃÔòµ´ = $“ç¬ÖŞ¿[$º¿ñ¸«é[1321]] . $§±Ñßî´[$º¿ñ¸«é[32]]; break; } if (!$„ÃÔòµ´) { show_json(LNG($º¿ñ¸«é[108]), !1); } return IO::info($„ÃÔòµ´); } public static function fileOut($°šğÅ‹í, $•ÉªÌö, $áÇÃ ² = false) { $®®•æ®Ü =& $_SERVER[ÆªÈ–¬]; $ÒùÚ‘•À = self::fileInfo($°šğÅ‹í, $•ÉªÌö); $ÚÏ’Èè =& $GLOBALS[$®®•æ®Ü[7]]; $áÇÃ ² = isset($ÚÏ’Èè[$®®•æ®Ü[1272]]) && $ÚÏ’Èè[$®®•æ®Ü[1272]] == 1; if (isset($ÚÏ’Èè[$®®•æ®Ü[33]]) && $ÚÏ’Èè[$®®•æ®Ü[33]] == $®®•æ®Ü[1323]) { return IO::fileOutImage($ÒùÚ‘•À[$®®•æ®Ü[87]], $ÚÏ’Èè[$®®•æ®Ü[1324]]); } IO::fileOut($ÒùÚ‘•À[$®®•æ®Ü[87]], $áÇÃ ², get_path_this($°šğÅ‹í)); } public static function listData($ïµÉ¾ÑÂ, $øà”ğ¸ = true) { $òØ¨õôˆ =& $_SERVER[ÆªÈ–¬]; if ($øà”ğ¸ && !IO::exist($ïµÉ¾ÑÂ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ïµÉ¾ÑÂ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $àƒ‹‡¸™ = self::pathHistory($ïµÉ¾ÑÂ); $Õ¯Ù•ø = array($òØ¨õôˆ[1322] => $àƒ‹‡¸™ . $òØ¨õôˆ[1309], $òØ¨õôˆ[1321] => rtrim(get_path_father($àƒ‹‡¸™), $òØ¨õôˆ[8]) . $òØ¨õôˆ[8], $òØ¨õôˆ[445] => array()); $ÄÌ×Ş„ = IO::getContent($Õ¯Ù•ø[$òØ¨õôˆ[1322]]); if ($ÄÌ×Ş„) { $ŠÛ³Ëı = json_decode($ÄÌ×Ş„, !0); if (is_array($ŠÛ³Ëı)) { $Õ¯Ù•ø[$òØ¨õôˆ[445]] = $ŠÛ³Ëı; } } return $Õ¯Ù•ø; } private static function saveData($¥‘ƒ, $ú¤¹ç³) { $ÓÀÇŠáù =& $_SERVER[ÆªÈ–¬]; self::log($ÓÀÇŠáù[1325] . $¥‘ƒ . $ÓÀÇŠáù[74] . count($ú¤¹ç³), $ÓÀÇŠáù[818]); if ($ú¤¹ç³) { return IO::setContent($¥‘ƒ, json_encode($ú¤¹ç³)); } $Å¿ç¨¢İ = IO::pathFather($¥‘ƒ); IO::remove($¥‘ƒ); self::clearEmptyFolder($Å¿ç¨¢İ); return !0; } public static function clearEmptyFolder($³•²ÓÀ—) { $¾°‹Õ =& $_SERVER[ÆªÈ–¬]; if (trim($³•²ÓÀ—, $¾°‹Õ[8]) == trim(self::$_historyBase, $¾°‹Õ[8])) { return; } $ÓŒ†ñàœ = IO::pathFather($³•²ÓÀ—); $İÒÚ“è = IO::has($³•²ÓÀ—, !0); if ($İÒÚ“è[$¾°‹Õ[239]] > 0 || $İÒÚ“è[$¾°‹Õ[240]] > 0) { return; } IO::remove($³•²ÓÀ—); self::clearEmptyFolder($ÓŒ†ñàœ); } private static function getBasePath() { $šÏá³Û =& $_SERVER[ÆªÈ–¬]; $¤ßçÙ¿ = Model($šÏá³Û[1326])->get($šÏá³Û[1327]); if ($¤ßçÙ¿) { if (!IO::exist($¤ßçÙ¿)) { IO::mkdir($¤ßçÙ¿); } if (get_path_this($¤ßçÙ¿) == $šÏá³Û[1312]) { $µÍÃ½–› = $šÏá³Û[1328] . rand_string(8); @rename($¤ßçÙ¿, get_path_father($¤ßçÙ¿) . $šÏá³Û[8] . $µÍÃ½–›); $¤ßçÙ¿ = DATA_PATH . $µÍÃ½–› . $šÏá³Û[8]; file_put_contents(DATA_PATH . $šÏá³Û[1259], $šÏá³Û[12]); Model($šÏá³Û[1326])->set($šÏá³Û[1327], $¤ßçÙ¿); } return $¤ßçÙ¿; } $¤ßçÙ¿ = DATA_PATH . $šÏá³Û[1328] . rand_string(8) . $šÏá³Û[8]; $¤ßçÙ¿ = IO::mkdir($¤ßçÙ¿); $¤ßçÙ¿ = rtrim($¤ßçÙ¿, $šÏá³Û[8]) . $šÏá³Û[8]; file_put_contents($¤ßçÙ¿ . $šÏá³Û[1259], $šÏá³Û[12]); file_put_contents(DATA_PATH . $šÏá³Û[1259], $šÏá³Û[12]); Model($šÏá³Û[1326])->set($šÏá³Û[1327], $¤ßçÙ¿); return $¤ßçÙ¿; } } class KodIO { const KOD_SOURCE = "\173\163\157\165\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\173\165\163\x65\162\x52\145\x63\171\143\x6c\x65\175"; const KOD_USER_FAV = "\x7b\165\x73\x65\162\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\x46\151\154\x65\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\x65\x72\x46\x69\154\145\124\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\x75\160\x52\157\157\x74\123\145\x6c\146\175"; const KOD_USER_SHARE = "\x7b\165\163\x65\162\x53\x68\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\162\x53\x68\x61\x72\x65\114\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\x65\124\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\141\x72\145\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\162\145\x49\x74\145\155\114\151\156\153\x7d"; const KOD_SEARCH = "\173\x73\145\141\162\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\143\153\175"; const KOD_IO = "\173\151\x6f\175"; const KOD_USER_RECENT = "\173\x75\x73\145\x72\122\x65\156\x63\145\156\164\x7d"; const KOD_USER_DRIVER = "\173\x64\162\x69\x76\145\162\175"; public static function typeList() { $‚¬–¨°¥ =& $_SERVER[ÆªÈ–¬]; return array($‚¬–¨°¥[1329] => self::KOD_SOURCE, $‚¬–¨°¥[1330] => self::KOD_USER_RECYCLE, $‚¬–¨°¥[1331] => self::KOD_USER_FAV, $‚¬–¨°¥[1332] => self::KOD_USER_FILE_TAG, $‚¬–¨°¥[1333] => self::KOD_USER_FILE_TYPE, $‚¬–¨°¥[1334] => self::KOD_GROUP_ROOT_SELF, $‚¬–¨°¥[1335] => self::KOD_USER_SHARE, $‚¬–¨°¥[1336] => self::KOD_USER_SHARE_LINK, $‚¬–¨°¥[1337] => self::KOD_USER_SHARE_TO_ME, $‚¬–¨°¥[1338] => self::KOD_SHARE_ITEM, $‚¬–¨°¥[1339] => self::KOD_SHARE_LINK, $‚¬–¨°¥[1340] => self::KOD_SEARCH, $‚¬–¨°¥[1341] => self::KOD_BLOCK, $‚¬–¨°¥[1342] => self::KOD_IO, $‚¬–¨°¥[1343] => self::KOD_USER_RECENT, $‚¬–¨°¥[1344] => self::KOD_USER_DRIVER); } public static function parse($­¼Ø•›Â) { $ÀˆşÉ =& $_SERVER[ÆªÈ–¬]; $­¼Ø•›Â = self::clear($­¼Ø•›Â); $­¸Âä›ú = array_values(self::typeList()); preg_match($ÀˆşÉ[1345], $­¼Ø•›Â, $í½²÷Óô); $¹…”ı¶• = array($ÀˆşÉ[496] => !1, $ÀˆşÉ[1346] => !1, $ÀˆşÉ[493] => !1, $ÀˆşÉ[87] => $­¼Ø•›Â, $ÀˆşÉ[1244] => !1, $ÀˆşÉ[1243] => $ÀˆşÉ[12]); if (is_array($í½²÷Óô) && count($í½²÷Óô) == 5) { $ö²‘­§Õ = $ÀˆşÉ[1347] . $í½²÷Óô[2] . $ÀˆşÉ[403]; if (in_array($ö²‘­§Õ, $­¸Âä›ú)) { $¹…”ı¶•[$ÀˆşÉ[1244]] = $í½²÷Óô[1]; $¹…”ı¶•[$ÀˆşÉ[33]] = $ö²‘­§Õ; $¹…”ı¶•[$ÀˆşÉ[1348]] = substr($ö²‘­§Õ, 1, -1); $¹…”ı¶•[$ÀˆşÉ[475]] = $í½²÷Óô[3]; } $¹…”ı¶•[$ÀˆşÉ[1243]] = $í½²÷Óô[4]; } $Ùë†Éïğ = array($ÀˆşÉ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¹…”ı¶•[$ÀˆşÉ[1311]] = in_array($¹…”ı¶•[$ÀˆşÉ[33]], $Ùë†Éïğ); return $¹…”ı¶•; } public static function isTruePath($‰ÔÕ¯ŠÕ) { $İ‚¡ íï =& $_SERVER[ÆªÈ–¬]; if (substr($‰ÔÕ¯ŠÕ, 0, 1) != $İ‚¡ íï[1347]) { return !0; } if (strpos($‰ÔÕ¯ŠÕ, $İ‚¡ íï[483]) === 0) { return !0; } if (strpos($‰ÔÕ¯ŠÕ, $İ‚¡ íï[1315]) === 0) { return !0; } if (strpos($‰ÔÕ¯ŠÕ, $İ‚¡ íï[1349]) === 0) { return !0; } if (strpos($‰ÔÕ¯ŠÕ, $İ‚¡ íï[1350]) === 0) { return !0; } if (strpos($‰ÔÕ¯ŠÕ, $İ‚¡ íï[1351]) === 0) { return !0; } return !1; } public static function clear($Ë¾¡ˆ·) { $ù¯Íü€Ğ =& $_SERVER[ÆªÈ–¬]; $Ë¾¡ˆ· = str_replace(array($ù¯Íü€Ğ[1150], $ù¯Íü€Ğ[262]), $ù¯Íü€Ğ[53], $Ë¾¡ˆ·); $Ë¾¡ˆ· = str_replace($ù¯Íü€Ğ[100], $ù¯Íü€Ğ[8], $Ë¾¡ˆ·); $ÃÈ²ÅÉƒ = $ù¯Íü€Ğ[1352]; if (substr($Ë¾¡ˆ·, 0, 3) == $ù¯Íü€Ğ[1353]) { $Ë¾¡ˆ· = substr($Ë¾¡ˆ·, 3); } while (strstr($Ë¾¡ˆ·, $ÃÈ²ÅÉƒ)) { $Ë¾¡ˆ· = str_replace($ÃÈ²ÅÉƒ, $ù¯Íü€Ğ[8], $Ë¾¡ˆ·); } $Ë¾¡ˆ· = preg_replace($ù¯Íü€Ğ[1354], $ù¯Íü€Ğ[8], $Ë¾¡ˆ·); if ($Ë¾¡ˆ· == $ù¯Íü€Ğ[8]) { return $ù¯Íü€Ğ[8]; } $Ë¾¡ˆ· = rtrim($Ë¾¡ˆ·, $ù¯Íü€Ğ[8]); return $Ë¾¡ˆ·; } public static function pathTrue($Ù’ãõãá) { $ìà›¶ÇÄ =& $_SERVER[ÆªÈ–¬]; if (!$Ù’ãõãá) { return $ìà›¶ÇÄ[12]; } $Ù’ãõãá = str_replace($ìà›¶ÇÄ[592], $ìà›¶ÇÄ[8], str_replace($ìà›¶ÇÄ[1355], $ìà›¶ÇÄ[8], $Ù’ãõãá)); $Ù’ãõãá = str_replace($ìà›¶ÇÄ[592], $ìà›¶ÇÄ[8], str_replace($ìà›¶ÇÄ[1355], $ìà›¶ÇÄ[8], $Ù’ãõãá)); if (!strstr($Ù’ãõãá, $ìà›¶ÇÄ[1353])) { return $Ù’ãõãá; } $Çº¸˜ª° = explode($ìà›¶ÇÄ[8], $Ù’ãõãá); foreach ($Çº¸˜ª° as $éîµöÆ‰ => $Œ„Ä‘é«) { if ($Œ„Ä‘é« !== $ìà›¶ÇÄ[1356]) { continue; } for ($ÉÃ¦‹Œö = $éîµöÆ‰; $ÉÃ¦‹Œö >= 0; $ÉÃ¦‹Œö--) { if ($Çº¸˜ª°[$ÉÃ¦‹Œö] === $ìà›¶ÇÄ[10] || $Çº¸˜ª°[$ÉÃ¦‹Œö] === $ìà›¶ÇÄ[1356] || $Çº¸˜ª°[$ÉÃ¦‹Œö] === -1) { continue; } if ($Çº¸˜ª°[$ÉÃ¦‹Œö] === $ìà›¶ÇÄ[12]) { $Çº¸˜ª°[$éîµöÆ‰] = -1; break; } $Çº¸˜ª°[$éîµöÆ‰] = -1; $Çº¸˜ª°[$ÉÃ¦‹Œö] = -1; break; } } $¼ˆÔêÍ = array(); foreach ($Çº¸˜ª° as $Œ„Ä‘é«) { if ($Œ„Ä‘é« !== -1) { $¼ˆÔêÍ[] = $Œ„Ä‘é«; } } $˜ÏÚ»°ç = implode($ìà›¶ÇÄ[8], $¼ˆÔêÍ); if (strpos($˜ÏÚ»°ç, $ìà›¶ÇÄ[1357]) === 0) { $˜ÏÚ»°ç = $ìà›¶ÇÄ[1353] . substr($˜ÏÚ»°ç, strlen($ìà›¶ÇÄ[1357])); } return $˜ÏÚ»°ç; } public static function pathUrlClear($˜Ï£¨„î) { $ˆ¹Ûœ¿õ =& $_SERVER[ÆªÈ–¬]; if (!$˜Ï£¨„î) { return $˜Ï£¨„î; } $˜Ï£¨„î = rawurldecode($˜Ï£¨„î); $˜Ï£¨„î = str_replace($ˆ¹Ûœ¿õ[1355], $ˆ¹Ûœ¿õ[8], $˜Ï£¨„î); if (strpos($˜Ï£¨„î, $ˆ¹Ûœ¿õ[76]) > 0) { $˜Ï£¨„î = substr($˜Ï£¨„î, 0, strpos($˜Ï£¨„î, $ˆ¹Ûœ¿õ[76])); } if (strpos($˜Ï£¨„î, $ˆ¹Ûœ¿õ[1358]) > 0) { $˜Ï£¨„î = substr($˜Ï£¨„î, 0, strpos($˜Ï£¨„î, $ˆ¹Ûœ¿õ[1358])); } return $˜Ï£¨„î; } public static function sourceID($ÍíÉ³©ñ) { $“ËÂø…× =& $_SERVER[ÆªÈ–¬]; $ÈÖíêÜö = self::parse($ÍíÉ³©ñ); if ($ÈÖíêÜö[$“ËÂø…×[33]] !== self::KOD_SOURCE) { show_json(LNG($“ËÂø…×[1359]), !1); } return $ÈÖíêÜö[$“ËÂø…×[475]]; } public static function make($ôš“Û‚) { if (!$ôš“Û‚) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ôš“Û‚)); } public static function makeShare($ğŒ‡ïŸÓ, $œò®½Ë¥) { return self::makePath(self::KOD_SHARE_ITEM, $ğŒ‡ïŸÓ, $œò®½Ë¥); } public static function makeFileTypePath($¦Ş™¦–ï) { return self::makePath(self::KOD_USER_FILE_TYPE, $¦Ş™¦–ï); } public static function makeFileTagPath($‹Õ®Œ…Ÿ) { return self::makePath(self::KOD_USER_FILE_TAG, $‹Õ®Œ…Ÿ); } public static function makePath($ùâ¶€¯ò, $´‰üš² = '', $ØĞˆ’©› = '') { $Ù†³ºÃ =& $_SERVER[ÆªÈ–¬]; $Éìª—‚Î = substr($ùâ¶€¯ò, 1, -1); $ñŒ°ìØº = $Ù†³ºÃ[1360] . $Éìª—‚Î . $Ù†³ºÃ[1361] . $´‰üš² . $Ù†³ºÃ[1362]; $ñŒ°ìØº = $ØĞˆ’©› ? $ñŒ°ìØº . $ØĞˆ’©› . $Ù†³ºÃ[8] : $ñŒ°ìØº; return $ñŒ°ìØº; } public static function hashPath($½à©µ¡×, $Û¡íÕå = true) { $é¶ùßÍ =& $_SERVER[ÆªÈ–¬]; $û®ÒÔĞï = is_array($½à©µ¡×) ? $½à©µ¡× : IO::info($½à©µ¡×); $Ğé§“„ = _get($û®ÒÔĞï, $é¶ùßÍ[1363], $é¶ùßÍ[12]); if (!$Ğé§“„ && isset($û®ÒÔĞï[$é¶ùßÍ[235]])) { $Ğé§“„ = trim($û®ÒÔĞï[$é¶ùßÍ[235]], $é¶ùßÍ[121]); } if (!$Ğé§“„ && isset($û®ÒÔĞï[$é¶ùßÍ[193]]) && $û®ÒÔĞï[$é¶ùßÍ[193]]) { $û®ÒÔĞï = IO::info(KodIO::make($û®ÒÔĞï[$é¶ùßÍ[193]])); $Ğé§“„ = _get($û®ÒÔĞï, $é¶ùßÍ[1363], $é¶ùßÍ[12]); } $“Ç ³ıª = md5($û®ÒÔĞï[$é¶ùßÍ[87]] . $û®ÒÔĞï[$é¶ùßÍ[79]] . $û®ÒÔĞï[$é¶ùßÍ[88]]); if (!$Ğé§“„ && file_exists($û®ÒÔĞï[$é¶ùßÍ[87]])) { $Ğé§“„ = Cache::get($“Ç ³ıª . $é¶ùßÍ[1364]); $Ğé§“„ = !1; if (!$Ğé§“„) { $Ğé§“„ = IO::hashSimple($û®ÒÔĞï[$é¶ùßÍ[87]]); Cache::set($“Ç ³ıª . $é¶ùßÍ[1364], $Ğé§“„, 3600 * 24 * 30); } } if ($Û¡íÕå && !$Ğé§“„) { } return $Ğé§“„ ? $Ğé§“„ : $“Ç ³ıª; } public static function hashPathSafe($øÔò¥, $¯Ş«èï¡ = true) { $úï©±ùÏ =& $_SERVER[ÆªÈ–¬]; $ÔÕÊ´ª¸ = self::hashPath($øÔò¥, $¯Ş«èï¡); return md5($ÔÕÊ´ª¸ . $úï©±ùÏ[1365] . Model($úï©±ùÏ[836])->get($úï©±ùÏ[837])); } public static function initSystemPath() { $ åª˜ø± =& $_SERVER[ÆªÈ–¬]; if (defined($ åª˜ø±[1366])) { return; } define($ åª˜ø±[1366], self::systemPath($ åª˜ø±[191])); define($ åª˜ø±[1367], self::systemPath($ åª˜ø±[1368])); define($ åª˜ø±[1369], self::systemPath($ åª˜ø±[1370])); define($ åª˜ø±[1371], self::systemPath($ åª˜ø±[1372])); IOHistory::bindEvent(); } public static function systemPath($¬ªìßœ) { $³‰óôŒ‚ =& $_SERVER[ÆªÈ–¬]; $ÀÓ”Øîš = $³‰óôŒ‚[1373] . ucfirst($¬ªìßœ); $«Îªé®Ç = Model($³‰óôŒ‚[836])->get($ÀÓ”Øîš); if ($«Îªé®Ç) { return $«Îªé®Ç; } if ($¬ªìßœ == $³‰óôŒ‚[191]) { $«Îªé®Ç = self::make(Model($³‰óôŒ‚[890])->systemRootPathAdd($³‰óôŒ‚[605])); } else { $«Îªé®Ç = self::systemPath($³‰óôŒ‚[191]); $’À«ãÉğ = self::sourceID($«Îªé®Ç); $«Îªé®Ç = self::make(Model($³‰óôŒ‚[890])->mkdir($’À«ãÉğ, $¬ªìßœ)); } Model($³‰óôŒ‚[836])->set($ÀÓ”Øîš, $«Îªé®Ç); return $«Îªé®Ç; } public static function systemFolder($ù­ÜŠÓ–) { $ºĞŞÎşñ = IO_PATH_SYSTEM_SOURCE . $ù­ÜŠÓ–; $ò°ù¥ì = Cache::get($ºĞŞÎşñ); if (!$ò°ù¥ì) { $­ŠÙÏà = IO::infoFullSimple($ºĞŞÎşñ); if (!$­ŠÙÏà) { $ò°ù¥ì = IO::mkdir($ºĞŞÎşñ, REPEAT_SKIP); } else { $ò°ù¥ì = $­ŠÙÏà[$_SERVER[ÆªÈ–¬][87]]; } Cache::set($ºĞŞÎşñ, $ò°ù¥ì, 3600 * 10); } return $ò°ù¥ì; } public static function defaultDriver() { return Model($_SERVER[ÆªÈ–¬][833])->defaultDriver(); } public static function defaultIO() { $øÉÚÒü¼ =& $_SERVER[ÆªÈ–¬]; $·ÀÜşÜ = self::defaultDriver(); return $øÉÚÒü¼[1374] . $·ÀÜşÜ[$øÉÚÒü¼[475]] . $øÉÚÒü¼[1362]; } public static function defaultDriverInit() { static $ï‡«úÏÍ = false; if ($ï‡«úÏÍ) { return $ï‡«úÏÍ; } $ï‡«úÏÍ = IO::init(self::defaultIO()); return $ï‡«úÏÍ; } public static function fileTypeList() { $§ı×ïÍÑ =& $_SERVER[ÆªÈ–¬]; $ Ìê‹† = $GLOBALS[$§ı×ïÍÑ[6]][$§ı×ïÍÑ[1375]]; foreach ($ Ìê‹† as $¸øè¹Ùş => $ô¤úóÒğ) { $£ø÷Æˆ§ = $§ı×ïÍÑ[1376] . $¸øè¹Ùş; $ûíÊˆù = LNG($£ø÷Æˆ§); if ($£ø÷Æˆ§ != $ûíÊˆù) { $ Ìê‹†[$¸øè¹Ùş][$§ı×ïÍÑ[32]] = $ûíÊˆù; } } return $ Ìê‹†; } public static function diskList($ºÚ’üŞ = true) { $ÂØ†ÏŸ = $_SERVER[ÆªÈ–¬][1377]; if ($ºÚ’üŞ) { $ÎûŸåûò = Cache::get($ÂØ†ÏŸ); if (is_array($ÎûŸåûò)) { return $ÎûŸåûò; } } $ÎûŸåûò = self::diskListGet(); Cache::set($ÂØ†ÏŸ, $ÎûŸåûò, 60); return $ÎûŸåûò; } public static function diskListGet() { $Á”ñÜ® =& $_SERVER[ÆªÈ–¬]; $¸äÑÔ = array(); if ($GLOBALS[$Á”ñÜ®[6]][$Á”ñÜ®[1378]] == $Á”ñÜ®[1379]) { $á¾½Š¢Í = $Á”ñÜ®[1380]; for ($Æ½êØİÑ = 0; $Æ½êØİÑ < strlen($á¾½Š¢Í); $Æ½êØİÑ++) { $âí–İ¦ô = $á¾½Š¢Í[$Æ½êØİÑ] . $Á”ñÜ®[1381]; if (file_exists($âí–İ¦ô)) { $¸äÑÔ[] = $âí–İ¦ô; } } return $¸äÑÔ; } if (!function_exists($Á”ñÜ®[101])) { $¸äÑÔ[] = $Á”ñÜ®[909]; return $¸äÑÔ; } $ÖöÏù… = explode($Á”ñÜ®[262], shell_exec($Á”ñÜ®[1382])); array_shift($ÖöÏù…); array_pop($ÖöÏù…); $ÖŸ‹€Æ = array($Á”ñÜ®[1383], $Á”ñÜ®[1384], $Á”ñÜ®[1385], $Á”ñÜ®[1386], $Á”ñÜ®[1387], $Á”ñÜ®[1388], $Á”ñÜ®[1389], $Á”ñÜ®[1390]); foreach ($ÖöÏù… as $²íó™Ãß) { $¨Œ•‚û¥ = preg_split($Á”ñÜ®[1391], $²íó™Ãß); $âí–İ¦ô = $¨Œ•‚û¥[count($¨Œ•‚û¥) - 1]; if (!strstr($¨Œ•‚û¥[0], $Á”ñÜ®[1392]) || !$âí–İ¦ô) { continue; } $Œ‘ö‡«Õ = rtrim($âí–İ¦ô, $Á”ñÜ®[8]) . $Á”ñÜ®[8]; if (in_array($Œ‘ö‡«Õ, $ÖŸ‹€Æ)) { continue; } $¸äÑÔ[] = $Œ‘ö‡«Õ; } return $¸äÑÔ; } public static function isSameDisk($·¿ò¦æ×, $Ûİ–¦ú†) { $ƒŸÁ‡‡Ô =& $_SERVER[ÆªÈ–¬]; if ($GLOBALS[$ƒŸÁ‡‡Ô[6]][$ƒŸÁ‡‡Ô[1378]] == $ƒŸÁ‡‡Ô[1379]) { return strtolower(substr($·¿ò¦æ×, 0, 1)) == strtolower(substr($Ûİ–¦ú†, 0, 1)); } $ª ¢ì˜Ä = self::diskList(); $ŠçÜû†˜ = !1; $ûÆ¹ÁÌ‚ = !1; sort($ª ¢ì˜Ä); $ª ¢ì˜Ä = array_reverse($ª ¢ì˜Ä); $·¿ò¦æ× = rtrim($·¿ò¦æ×, $ƒŸÁ‡‡Ô[8]) . $ƒŸÁ‡‡Ô[8]; $Ûİ–¦ú† = rtrim($Ûİ–¦ú†, $ƒŸÁ‡‡Ô[8]) . $ƒŸÁ‡‡Ô[8]; foreach ($ª ¢ì˜Ä as $‰õ«şÀÔ) { $ßÃïÃÈ‡ = strlen($‰õ«şÀÔ); if (!$ŠçÜû†˜ && substr($·¿ò¦æ×, 0, $ßÃïÃÈ‡) == $‰õ«şÀÔ) { $ŠçÜû†˜ = $‰õ«şÀÔ; } if (!$ûÆ¹ÁÌ‚ && substr($Ûİ–¦ú†, 0, $ßÃïÃÈ‡) == $‰õ«şÀÔ) { $ûÆ¹ÁÌ‚ = $‰õ«şÀÔ; } if ($ŠçÜû†˜ && $ûÆ¹ÁÌ‚) { break; } } return $ŠçÜû†˜ === $ûÆ¹ÁÌ‚; } public static function transferType($å¢¢’ŸÄ, $Ìëõ—‘±) { $Ğ²ø÷ÎĞ =& $_SERVER[ÆªÈ–¬]; $ÌòéÀ = self::driverType($å¢¢’ŸÄ); $İ–É§†Ø = self::driverType($Ìëõ—‘±); if ($ÌòéÀ[$Ğ²ø÷ÎĞ[33]] == $İ–É§†Ø[$Ğ²ø÷ÎĞ[33]] && $ÌòéÀ[$Ğ²ø÷ÎĞ[1393]] == $İ–É§†Ø[$Ğ²ø÷ÎĞ[1393]]) { return $Ğ²ø÷ÎĞ[1394]; } if ($ÌòéÀ[$Ğ²ø÷ÎĞ[33]] == $Ğ²ø÷ÎĞ[942] && $İ–É§†Ø[$Ğ²ø÷ÎĞ[33]] == $Ğ²ø÷ÎĞ[109]) { return $Ğ²ø÷ÎĞ[1272]; } if ($ÌòéÀ[$Ğ²ø÷ÎĞ[33]] == $Ğ²ø÷ÎĞ[109] && $İ–É§†Ø[$Ğ²ø÷ÎĞ[33]] == $Ğ²ø÷ÎĞ[942]) { return $Ğ²ø÷ÎĞ[110]; } return $Ğ²ø÷ÎĞ[1395]; } public static function driverType($­ÑÃ­Å¯) { $Ç¼™°ÇĞ =& $_SERVER[ÆªÈ–¬]; $ÊËØÉÅ = str_replace($Ç¼™°ÇĞ[1396], $Ç¼™°ÇĞ[12], strtolower($­ÑÃ­Å¯->getType())); if ($ÊËØÉÅ == $Ç¼™°ÇĞ[823] || $ÊËØÉÅ == $Ç¼™°ÇĞ[1397] || $ÊËØÉÅ == $Ç¼™°ÇĞ[1398]) { $­ÑÃ­Å¯ = self::defaultDriverInit(); } else { if ($ÊËØÉÅ == $Ç¼™°ÇĞ[1282] || $ÊËØÉÅ == $Ç¼™°ÇĞ[1399]) { $­ÑÃ­Å¯ = IO::init($­ÑÃ­Å¯->pathParse[$Ç¼™°ÇĞ[1225]]); } } $Õú”‰× = $­ÑÃ­Å¯->path; $ÊËØÉÅ = str_replace($Ç¼™°ÇĞ[1396], $Ç¼™°ÇĞ[12], strtolower($­ÑÃ­Å¯->getType())); if ($ÊËØÉÅ == $Ç¼™°ÇĞ[109]) { return array($Ç¼™°ÇĞ[33] => $Ç¼™°ÇĞ[109], $Ç¼™°ÇĞ[1393] => $Ç¼™°ÇĞ[12], $Ç¼™°ÇĞ[87] => $Õú”‰×, $Ç¼™°ÇĞ[98] => $­ÑÃ­Å¯); } return array($Ç¼™°ÇĞ[33] => $Ç¼™°ÇĞ[942], $Ç¼™°ÇĞ[1393] => $­ÑÃ­Å¯->pathDriver, $Ç¼™°ÇĞ[87] => $Õú”‰×, $Ç¼™°ÇĞ[98] => $­ÑÃ­Å¯); } public static function pathDriverType($Æ²à¿ï”) { return $Æ²à¿ï” ? self::driverType(IO::init($Æ²à¿ï”)) : !1; } public static function pathDriverLocal($¹¹Ìğ¸Ç) { $¬Û÷ÚáÚ =& $_SERVER[ÆªÈ–¬]; $­•ü = $¹¹Ìğ¸Ç ? self::driverType(IO::init($¹¹Ìğ¸Ç)) : !1; return strtolower($­•ü[$¬Û÷ÚáÚ[33]]) == $¬Û÷ÚáÚ[109] ? !0 : !1; } public static function allowCover($›Å—§ü, $¿â·Æš€ = true) { $Ù‘¢ºÔÏ =& $_SERVER[ÆªÈ–¬]; if (is_string($›Å—§ü)) { $›Å—§ü = IO::info($›Å—§ü); } if (!$›Å—§ü || $›Å—§ü[$Ù‘¢ºÔÏ[33]] == $Ù‘¢ºÔÏ[78] || $›Å—§ü[$Ù‘¢ºÔÏ[79]] <= 100) { return !1; } if (isset($›Å—§ü[$Ù‘¢ºÔÏ[1400]]) || !$›Å—§ü[$Ù‘¢ºÔÏ[87]]) { return !1; } if (isset($›Å—§ü[$Ù‘¢ºÔÏ[232]]) && !$›Å—§ü[$Ù‘¢ºÔÏ[232]]) { return !1; } static $­»Û¢î› = false; if (!$­»Û¢î› || !$¿â·Æš€) { $×¾Œ´—­ = self::driverType(IO::init($›Å—§ü[$Ù‘¢ºÔÏ[87]])); $ò¬ËòÚ = $×¾Œ´—­[$Ù‘¢ºÔÏ[98]]; $­»Û¢î› = $Ù‘¢ºÔÏ[196]; if (strtolower($×¾Œ´—­[$Ù‘¢ºÔÏ[33]]) == $Ù‘¢ºÔÏ[109]) { $­»Û¢î› = $Ù‘¢ºÔÏ[1401]; } if ($×¾Œ´—­[$Ù‘¢ºÔÏ[98]] && is_array($×¾Œ´—­[$Ù‘¢ºÔÏ[98]]->config)) { $­ëÉß” = $×¾Œ´—­[$Ù‘¢ºÔÏ[98]]->config; if (isset($­ëÉß”[$Ù‘¢ºÔÏ[1402]]) && $­ëÉß”[$Ù‘¢ºÔÏ[1402]]) { $­»Û¢î› = $Ù‘¢ºÔÏ[1401]; } } $£€ğÏöö = KodIO::defaultDriver(); if (strtolower($£€ğÏöö[$Ù‘¢ºÔÏ[33]]) == $Ù‘¢ºÔÏ[109] && is_array($£€ğÏöö[$Ù‘¢ºÔÏ[6]])) { $Üç—š£ = $éí­¦„³[$Ù‘¢ºÔÏ[6]][$Ù‘¢ºÔÏ[1255]]; if (substr($Üç—š£, 0, 2) == $Ù‘¢ºÔÏ[1403]) { $Üç—š£ = str_replace($Ù‘¢ºÔÏ[1403], BASIC_PATH, $Üç—š£); } $Üç—š£ = str_replace($Ù‘¢ºÔÏ[592], $Ù‘¢ºÔÏ[8], $Üç—š£); if (substr($›Å—§ü[$Ù‘¢ºÔÏ[87]], 0, strlen($Üç—š£)) == $Üç—š£) { $­»Û¢î› = $Ù‘¢ºÔÏ[196]; } } } return $­»Û¢î› == $Ù‘¢ºÔÏ[1401] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ÌÀôÚÕ„) { parent::__construct($ÌÀôÚÕ„); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Ñ¥Áìë¢) { $¤¤Ùš¹ =& $_SERVER[ÆªÈ–¬]; if (substr($Ñ¥Áìë¢, 0, 7) == $¤¤Ùš¹[313]) { $Ñ¥Áìë¢ = $¤¤Ùš¹[314] . substr($Ñ¥Áìë¢, 7); } header($¤¤Ùš¹[175] . $Ñ¥Áìë¢); die; } } goto E±°¯Ç¸–; FºÆ¨µäÔÄ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\x65\155\117\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ÜïÂâ²À = false, $°§é¥í§ = "\x6d\157\x64\151\x66\171\x54\151\155\145", $¿ç–ŸºĞ = false) { $ÜıõÍıø = Model($this->modelType)->get(!1, $this->optionType, !0); $¹Ş§ = array_values($ÜıõÍıø); if ($¹Ş§ && $¹Ş§[0] && !is_array($¹Ş§[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÜıõÍıø = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÜıõÍıø) { return $ÜïÂâ²À ? null : array(); } if (!$ÜïÂâ²À) { $ÜıõÍıø = array_filter(array_values($ÜıõÍıø)); return array_sort_by($ÜıõÍıø, $°§é¥í§, $¿ç–ŸºĞ); } return $ÜıõÍıø[$_SERVER[ÆªÈ–¬][472] . $ÜïÂâ²À]; } public function insert($´ıö‘) { $õéèı­ =& $_SERVER[ÆªÈ–¬]; $´ıö‘ = array_field_key($´ıö‘, $this->field); $Şü‡İÈØ = Model($this->modelType)->get($õéèı­[473], $this->optionType . $õéèı­[474]); $Şü‡İÈØ = $Şü‡İÈØ ? $Şü‡İÈØ : 0; $´ıö‘[$õéèı­[475]] = ++$Şü‡İÈØ; $´ıö‘[$õéèı­[231]] = time(); $´ıö‘[$õéèı­[88]] = time(); Model($this->modelType)->set($õéèı­[473], $Şü‡İÈØ, $this->optionType . $õéèı­[474]); Model($this->modelType)->set($õéèı­[472] . $Şü‡İÈØ, $´ıö‘, $this->optionType); return $Şü‡İÈØ; } public function update($ŠÂ’Ù™Ñ, $ãÁ¿Ê”á) { $ÑÎ»¬â° =& $_SERVER[ÆªÈ–¬]; $ãÁ¿Ê”á = array_field_key($ãÁ¿Ê”á, $this->field); $üëĞâ­— = $this->listData($ŠÂ’Ù™Ñ); if (!$üëĞâ­— || !$ŠÂ’Ù™Ñ) { return !1; } $ãÁ¿Ê”á = array_merge($üëĞâ­—, $ãÁ¿Ê”á); $ãÁ¿Ê”á[$ÑÎ»¬â°[88]] = time(); return Model($this->modelType)->set($ÑÎ»¬â°[472] . $ŠÂ’Ù™Ñ, $ãÁ¿Ê”á, $this->optionType); } public function remove($ŠùöÑ±š) { if (!$ŠùöÑ±š) { return !1; } return Model($this->modelType)->remove($_SERVER[ÆªÈ–¬][472] . $ŠùöÑ±š, $this->optionType); } public function clear() { $ƒîõ®­ =& $_SERVER[ÆªÈ–¬]; Model($this->modelType)->remove($ƒîõ®­[473], $this->optionType . $ƒîõ®­[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($’¶Ş´Ñ˜, $ûÛÛóœ±) { if (!$ûÛÛóœ±) { return !1; } $©™¹¥Õè = $this->listData(); $©™¹¥Õè = array_to_keyvalue($©™¹¥Õè, $’¶Ş´Ñ˜); return isset($©™¹¥Õè[$ûÛÛóœ±]) ? $©™¹¥Õè[$ûÛÛóœ±] : !1; } public function findByName($ãª „„ø) { return $this->findByKey($_SERVER[ÆªÈ–¬][32], $ãª „„ø); } protected function resetData($ş¨¤Èõ¼) { $¸’ïğ¿‡ =& $_SERVER[ÆªÈ–¬]; $ş¨¤Èõ¼ = is_array($ş¨¤Èõ¼) ? $ş¨¤Èõ¼ : array(); $ª¬œÊ¿¦ = array(); for ($¶½®ªŠÈ = 0; $¶½®ªŠÈ < count($ş¨¤Èõ¼); $¶½®ªŠÈ++) { $ª¬œÊ¿¦[$¸’ïğ¿‡[472] . $ş¨¤Èõ¼[$¶½®ªŠÈ][$¸’ïğ¿‡[475]]] = $ş¨¤Èõ¼[$¶½®ªŠÈ]; } return Model($this->modelType)->set($ª¬œÊ¿¦, !1, $this->optionType); } private function getAutoName($”™ÁÜ×å) { $²Îî£ÓÇ = array_to_keyvalue($this->listData(), $_SERVER[ÆªÈ–¬][32]); if (!$²Îî£ÓÇ || !isset($²Îî£ÓÇ[$”™ÁÜ×å])) { return $”™ÁÜ×å; } for ($ç Î—†é = 1; $ç Î—†é < count($²Îî£ÓÇ); $ç Î—†é++) { $ÙÖ†ã¡ı = $”™ÁÜ×å . "\x28{$ç Î—†é}\x29"; if (!isset($²Îî£ÓÇ[$ÙÖ†ã¡ı])) { return $ÙÖ†ã¡ı; } } return $ÙÖ†ã¡ı; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ùŠÈîšù = false, $èÊ¼†ıœ = '', $ÍÅí‹Å† = false) { $ùÓìéˆ¤ =& $_SERVER[ÆªÈ–¬]; $¤¯Ö´«ô = $this->cacheGet($èÊ¼†ıœ); $½±îªõ¤ = $this->optionDefault($èÊ¼†ıœ); $½±îªõ¤ = is_array($½±îªõ¤) ? $½±îªõ¤ : array(); if (is_array($¤¯Ö´«ô)) { $¤¯Ö´«ô = array_merge($½±îªõ¤, $¤¯Ö´«ô); return $ùŠÈîšù ? isset($¤¯Ö´«ô[$ùŠÈîšù]) ? $¤¯Ö´«ô[$ùŠÈîšù] : null : $¤¯Ö´«ô; } $Ë’É¸› = $this->filterWhere(array($ùÓìéˆ¤[33] => $èÊ¼†ıœ)); $¤¯Ö´«ô = $this->where($Ë’É¸›)->select(); $¤¯Ö´«ô = array_to_keyvalue($¤¯Ö´«ô, $ùÓìéˆ¤[97], $ùÓìéˆ¤[450]); foreach ($¤¯Ö´«ô as $³­ÓÈèÇ => $‡è¸…ªˆ) { if ($ÍÅí‹Å† || in_array($³­ÓÈèÇ, $this->jsonField)) { $¤¯Ö´«ô[$³­ÓÈèÇ] = json_decode($‡è¸…ªˆ, !0); } } $this->cacheSet($èÊ¼†ıœ, $¤¯Ö´«ô); $¤¯Ö´«ô = array_merge($½±îªõ¤, $¤¯Ö´«ô); return $ùŠÈîšù ? $¤¯Ö´«ô[$ùŠÈîšù] : $¤¯Ö´«ô; } public function set($¸¤²âô, $‹»ö²¸« = false, $¿İ¶š = '') { $¾ ¡Ö¯ =& $_SERVER[ÆªÈ–¬]; $this->cacheRemove($¿İ¶š); $òÈÄªÄ = array(); $ıáÇ›³Ã = is_array($¸¤²âô) ? $¸¤²âô : array($¸¤²âô => $‹»ö²¸«); foreach ($ıáÇ›³Ã as $”ªÌó©  => $Û©·Ü›Ï) { if (is_array($Û©·Ü›Ï)) { $Û©·Ü›Ï = json_encode_force($Û©·Ü›Ï); } $this->checkLength($Û©·Ü›Ï, !1, $this->tableName . $¾ ¡Ö¯[4] . $¸¤²âô); $Û©·Ü›Ï = self::textEncode($Û©·Ü›Ï); $ıáÇ›³Ã = array($¾ ¡Ö¯[33] => $¿İ¶š, $¾ ¡Ö¯[97] => $”ªÌó© , $¾ ¡Ö¯[450] => $Û©·Ü›Ï); $òÈÄªÄ[] = $this->filterWhere($ıáÇ›³Ã); } if (!$òÈÄªÄ) { return !0; } $ ó©•ŞÄ = $this->cacheKey($¾ ¡Ö¯[476]); CacheLock::lock($ ó©•ŞÄ); $±ˆó‘ğ = $this->addAll($òÈÄªÄ, array(), !0); CacheLock::unlock($ ó©•ŞÄ); return $±ˆó‘ğ; } protected function optionDefault($®«¹ÇÎÆ = '') { return !1; } public function setDeep($ı÷Ô¹, $‡ê’×¬– = false, $Æ¨İŒ˜ = '') { $œ®î¼» = explode($_SERVER[ÆªÈ–¬][10], $ı÷Ô¹); $£ßÂ‰œ€ = $this->get(); array_set_value($£ßÂ‰œ€, $ı÷Ô¹, $‡ê’×¬–); $this->set($œ®î¼»[0], $£ßÂ‰œ€[$œ®î¼»[0]], $Æ¨İŒ˜); } public function remove($ªî¾‘«Ò, $³¦¨å³¶ = '') { $‰ÎÂæÛÍ =& $_SERVER[ÆªÈ–¬]; $this->cacheRemove($³¦¨å³¶); $å™˜÷Òú = $this->filterWhere(array($‰ÎÂæÛÍ[97] => $ªî¾‘«Ò, $‰ÎÂæÛÍ[33] => $³¦¨å³¶)); if (is_null($ªî¾‘«Ò)) { unset($å™˜÷Òú[$‰ÎÂæÛÍ[97]]); } return $this->where($å™˜÷Òú)->delete(); } public function cacheSet($îŒñê“, $•±âñá² = false) { return Cache::set($this->cacheKey($îŒñê“), $•±âñá²); } public function cacheGet($»È¼İ…¼) { return Cache::get($this->cacheKey($»È¼İ…¼)); } public function cacheRemove($ÂõşÙİ) { return Cache::remove($this->cacheKey($ÂõşÙİ)); } protected function filterWhere($ÄÈ¤Şğä) { return $ÄÈ¤Şğä; } protected function cacheKey($Ş•Âß‘€) { return $Ş•Âß‘€; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\x65"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\155\145" => "\151\x6f\x5f\x73\x6f\165\162\x63\x65\137\x6d\145\164\x61", "\155\145\164\x61\106\151\145\x6c\144" => "\163\157\x75\162\143\x65\x49\104"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\x54\x69\155\145", "\x74\151\x6d\x65", "\x69\156\163\x65\162\164", "\x66\x75\156\x63\164\151\x6f\x6e"), array("\x63\x72\x65\141\x74\145\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\x6e\163\145\162\x74", "\146\x75\x6e\x63\164\151\x6f\156"), array("\x76\151\x65\167\124\x69\155\x65", "\x74\x69\155\145", "\x69\156\163\145\162\164", "\146\165\x6e\x63\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ˆÙö÷€£) { return $this->listSource(array($_SERVER[ÆªÈ–¬][477] => $ˆÙö÷€£)); } public function typeName($·Áä†»š) { static $î•½ğÎù = array(self::TYPE_SYSTEM => "\163\171\x73\x74\145\x6d", self::TYPE_USER => "\x75\x73\145\162", self::TYPE_GROUP => "\147\x72\157\x75\160"); return $î•½ğÎù[$·Áä†»š . $_SERVER[ÆªÈ–¬][12]]; } public function sourceListInfo($¾Ëàô¡®, $Â¨ìõ‘ñ = false) { $ÉèºŠûÔ =& $_SERVER[ÆªÈ–¬]; $¾Ëàô¡® = $¾Ëàô¡® ? $¾Ëàô¡® : array(); $¾Ëàô¡® = array_filter(array_unique($¾Ëàô¡®)); if (!$¾Ëàô¡®) { return array(); } $âãæïıê = $this->where(array($ÉèºŠûÔ[193] => array($ÉèºŠûÔ[7], $¾Ëàô¡®)))->select(); $this->_listDataApply($âãæïıê, $Â¨ìõ‘ñ); return array_to_keyvalue($âãæïıê, $ÉèºŠûÔ[193]); } public function pathInfoFilter(&$ßí½ÉÒ—) { $îø³ûäÂ =& $_SERVER[ÆªÈ–¬]; static $¦Ã¿¼€û = false; static $ù¢ü²äú = false; static $¡½ÌØ“ = false; if (!$¦Ã¿¼€û) { $æ¤èî÷ = $îø³ûäÂ[478]; $æ¤èî÷ .= $îø³ûäÂ[479]; $æ¤èî÷ .= $îø³ûäÂ[480]; $©µØç³ = $îø³ûäÂ[481]; $î¼°¥Ú« = explode($îø³ûäÂ[50], $©µØç³); $¦Ã¿¼€û = explode($îø³ûäÂ[50], $æ¤èî÷); $ù¢ü²äú = array(); foreach ($¦Ã¿¼€û as $ÄÈÓ³Õˆ) { if (in_array($ÄÈÓ³Õˆ, $î¼°¥Ú«)) { continue; } $ù¢ü²äú[] = $ÄÈÓ³Õˆ; } $¡½ÌØ“ = explode($îø³ûäÂ[50], $îø³ûäÂ[482]); } foreach ($¡½ÌØ“ as $ÓƒÂ²¦ƒ) { if (isset($ßí½ÉÒ—[$ÓƒÂ²¦ƒ])) { $ßí½ÉÒ—[$ÓƒÂ²¦ƒ] = intval($ßí½ÉÒ—[$ÓƒÂ²¦ƒ]); } } $ßí½ÉÒ—[$îø³ûäÂ[87]] = $îø³ûäÂ[483] . $ßí½ÉÒ—[$îø³ûäÂ[193]] . $îø³ûäÂ[484]; $ßí½ÉÒ—[$îø³ûäÂ[33]] = $ßí½ÉÒ—[$îø³ûäÂ[485]] == 1 ? $îø³ûäÂ[78] : $îø³ûäÂ[230]; $ßí½ÉÒ—[$îø³ûäÂ[190]] = $this->typeName($ßí½ÉÒ—[$îø³ûäÂ[190]]); if ($ßí½ÉÒ—[$îø³ûäÂ[485]] != 1) { $ßí½ÉÒ—[$îø³ûäÂ[169]] = $ßí½ÉÒ—[$îø³ûäÂ[486]]; unset($ßí½ÉÒ—[$îø³ûäÂ[486]]); } $óè”–¿ª = $¦Ã¿¼€û; if (isset($ßí½ÉÒ—[$îø³ûäÂ[487]]) && $ßí½ÉÒ—[$îø³ûäÂ[487]][$îø³ûäÂ[488]] == -1) { $óè”–¿ª = $ù¢ü²äú; } $ßí½ÉÒ— = array_field_key($ßí½ÉÒ—, $óè”–¿ª); return $ßí½ÉÒ—; } public function listUserFav() { $İ§ë·¦Æ =& $_SERVER[ÆªÈ–¬]; $ÕÏ ö¤ì = Model($İ§ë·¦Æ[489])->listData(); $Ğ“Ò¿²§ = array_filter_by_field($ÕÏ ö¤ì, $İ§ë·¦Æ[33], $İ§ë·¦Æ[490]); $Ğ“Ò¿²§ = array_to_keyvalue($Ğ“Ò¿²§, $İ§ë·¦Æ[12], $İ§ë·¦Æ[87]); if ($Ğ“Ò¿²§) { $Ñ«âšŸ™ = $this->listSource(array($İ§ë·¦Æ[491] => array($İ§ë·¦Æ[492], $Ğ“Ò¿²§))); } $Ñ«âšŸ™ = array_to_keyvalue($Ñ«âšŸ™[$İ§ë·¦Æ[445]], $İ§ë·¦Æ[193]); foreach ($ÕÏ ö¤ì as &$õÙõİ±) { $õÙõİ± = array($İ§ë·¦Æ[493] => $õÙõİ±[$İ§ë·¦Æ[475]], $İ§ë·¦Æ[494] => $õÙõİ±[$İ§ë·¦Æ[32]], $İ§ë·¦Æ[495] => $õÙõİ±[$İ§ë·¦Æ[87]], $İ§ë·¦Æ[496] => $õÙõİ±[$İ§ë·¦Æ[33]], $İ§ë·¦Æ[497] => $õÙõİ±[$İ§ë·¦Æ[231]], $İ§ë·¦Æ[498] => $õÙõİ±[$İ§ë·¦Æ[88]]); if ($õÙõİ±[$İ§ë·¦Æ[33]] == $İ§ë·¦Æ[490] && $Ñ«âšŸ™[$õÙõİ±[$İ§ë·¦Æ[87]]]) { $õÙõİ±[$İ§ë·¦Æ[90]] = $Ñ«âšŸ™[$õÙõİ±[$İ§ë·¦Æ[87]]]; } } unset($õÙõİ±); return $ÕÏ ö¤ì; } public function listUserTag($Æ«³“è) { $Îç¥†¼ë =& $_SERVER[ÆªÈ–¬]; if ($Æ«³“è && !is_array($Æ«³“è)) { $Æ«³“è = array($Æ«³“è); } $İËÈ–Úˆ = Model($Îç¥†¼ë[499])->listData(); $ªóºù‰ò = array(); $³í¼àŞõ = array(); foreach ($İËÈ–Úˆ as $øÖºƒ×Æ) { $€»¸Â§§ = $øÖºƒ×Æ[$Îç¥†¼ë[87]]; if (!$€»¸Â§§) { continue; } if (!isset($³í¼àŞõ[$€»¸Â§§])) { $³í¼àŞõ[$€»¸Â§§] = array(); } $³í¼àŞõ[$€»¸Â§§][] = $øÖºƒ×Æ[$Îç¥†¼ë[500]]; $ªóºù‰ò[$øÖºƒ×Æ[$Îç¥†¼ë[87]]] = $øÖºƒ×Æ; } $€¹Ğ—®Ô = array(); $¿öÉšõÖ = array(); $ˆ‹ôìì = array(); foreach ($³í¼àŞõ as $±ªİµ€ü => $‚ˆÅ•Ê) { $ñÈ§„®® = !0; if (!$Æ«³“è) { $€¹Ğ—®Ô[] = $±ªİµ€ü; continue; } foreach ($Æ«³“è as $×Ë…Ç…œ) { if (!in_array($×Ë…Ç…œ, $‚ˆÅ•Ê)) { $ñÈ§„®® = !1; break; } } if (!$ñÈ§„®®) { continue; } if (!is_numeric($±ªİµ€ü)) { $¸ç² ø = $ªóºù‰ò[$±ªİµ€ü]; $¼Øï·¿’ = array($Îç¥†¼ë[32] => $¸ç² ø[$Îç¥†¼ë[32]], $Îç¥†¼ë[87] => $¸ç² ø[$Îç¥†¼ë[87]], $Îç¥†¼ë[33] => $¸ç² ø[$Îç¥†¼ë[33]], $Îç¥†¼ë[90] => array($Îç¥†¼ë[501] => 1), $Îç¥†¼ë[232] => !0); if ($¸ç² ø[$Îç¥†¼ë[33]] == $Îç¥†¼ë[230]) { $ˆ‹ôìì[] = $¼Øï·¿’; } if ($¸ç² ø[$Îç¥†¼ë[33]] == $Îç¥†¼ë[78]) { $¿öÉšõÖ[] = $¼Øï·¿’; } continue; } $€¹Ğ—®Ô[] = $±ªİµ€ü; } if ($€¹Ğ—®Ô) { $Œ©¬Ç¶ß = $this->listSource(array($Îç¥†¼ë[491] => array($Îç¥†¼ë[492], $€¹Ğ—®Ô))); } $Œ©¬Ç¶ß = $Œ©¬Ç¶ß ? $Œ©¬Ç¶ß : array($Îç¥†¼ë[85] => array(), $Îç¥†¼ë[86] => array()); $Œ©¬Ç¶ß[$Îç¥†¼ë[85]] = array_merge($Œ©¬Ç¶ß[$Îç¥†¼ë[85]], $¿öÉšõÖ); $Œ©¬Ç¶ß[$Îç¥†¼ë[86]] = array_merge($Œ©¬Ç¶ß[$Îç¥†¼ë[86]], $ˆ‹ôìì); if (isset($Œ©¬Ç¶ß[$Îç¥†¼ë[442]]) && count($€¹Ğ—®Ô) == $Œ©¬Ç¶ß[$Îç¥†¼ë[442]][$Îç¥†¼ë[443]]) { return $Œ©¬Ç¶ß; } $î ³—Á¦ = array(); $šÙ«ÌöÂ = array_to_keyvalue($Œ©¬Ç¶ß[$Îç¥†¼ë[85]], $Îç¥†¼ë[12], $Îç¥†¼ë[193]); $«ÙúÙİ = array_to_keyvalue($Œ©¬Ç¶ß[$Îç¥†¼ë[86]], $Îç¥†¼ë[12], $Îç¥†¼ë[193]); $ª«ÛÉì¡ = array_merge($«ÙúÙİ, $šÙ«ÌöÂ); foreach ($€¹Ğ—®Ô as $€»¸Â§§) { if (!in_array($€»¸Â§§, $ª«ÛÉì¡)) { $î ³—Á¦[] = $€»¸Â§§; } } if ($î ³—Á¦) { Model($Îç¥†¼ë[502])->removeBySource($î ³—Á¦); } return $Œ©¬Ç¶ß; } public function listUserRecycle() { $ĞÜÆƒ†© =& $_SERVER[ÆªÈ–¬]; $Ä¼Ë†£ = Model($ĞÜÆƒ†©[503])->listData(); if (!$Ä¼Ë†£) { return array(); } $•»Í´¿í = array($ĞÜÆƒ†©[491] => array($ĞÜÆƒ†©[492], $Ä¼Ë†£), $ĞÜÆƒ†©[504] => 1); return $this->listSource($•»Í´¿í); } public function listSource($ŒÇ±¬ê, $¾Œ÷ ë = 3000, $Š¨¦à£° = false) { $½¸ŞĞÉ =& $_SERVER[ÆªÈ–¬]; if (!isset($ŒÇ±¬ê[$½¸ŞĞÉ[505]])) { $ŒÇ±¬ê[$½¸ŞĞÉ[505]] = 0; } if (isset($ŒÇ±¬ê[$½¸ŞĞÉ[192]]) && $ŒÇ±¬ê[$½¸ŞĞÉ[192]] == $½¸ŞĞÉ[228]) { $ŒÇ±¬ê[$½¸ŞĞÉ[486]] = array($½¸ŞĞÉ[407], $½¸ŞĞÉ[506]); } $¹Ÿµ³›– = $½¸ŞĞÉ[507]; $ü±œ†¶Â = $this->field($¹Ÿµ³›–)->_makeOrder()->where($ŒÇ±¬ê)->selectPage($¾Œ÷ ë); $this->_listPageCheck($ü±œ†¶Â, $¹Ÿµ³›–, $ŒÇ±¬ê); $this->_listDataApply($ü±œ†¶Â[$½¸ŞĞÉ[445]], $Š¨¦à£°); $this->_listMake($ü±œ†¶Â); return $ü±œ†¶Â; } private function _listPageCheck(&$Í³ëÕôÛ, $¤öÆ”é§, $÷¢÷½Èä) { $Æ­Æ…æ¸ =& $_SERVER[ÆªÈ–¬]; if (!is_array($Í³ëÕôÛ[$Æ­Æ…æ¸[442]])) { return; } $âŒ­²¬ï = $Í³ëÕôÛ[$Æ­Æ…æ¸[442]]; if ($âŒ­²¬ï[$Æ­Æ…æ¸[444]] <= 1) { return; } if ($âŒ­²¬ï[$Æ­Æ…æ¸[443]] >= 100000) { return; } if (Model($Æ­Æ…æ¸[508])->get($Æ­Æ…æ¸[509]) != $Æ­Æ…æ¸[510]) { return; } $¤öÆ”é§ = str_replace(array($Æ­Æ…æ¸[53], $Æ­Æ…æ¸[418], $Æ­Æ…æ¸[262]), $Æ­Æ…æ¸[12], $¤öÆ”é§); $¤öÆ”é§ = $Æ­Æ…æ¸[511] . str_replace($Æ­Æ…æ¸[50], $Æ­Æ…æ¸[512], $¤öÆ”é§) . $Æ­Æ…æ¸[513]; $ùö£å¼• = $Æ­Æ…æ¸[514]; $ùö£å¼• = $ùö£å¼• . $Æ­Æ…æ¸[515]; $±Ãé­ = $âŒ­²¬ï[$Æ­Æ…æ¸[439]] * ($âŒ­²¬ï[$Æ­Æ…æ¸[429]] - 1) . $Æ­Æ…æ¸[50] . $âŒ­²¬ï[$Æ­Æ…æ¸[439]]; $ü÷µ¶ó = $this->_makeOrder(!0); $’®¾£Î = $Æ­Æ…æ¸[511] . str_replace($Æ­Æ…æ¸[50], $Æ­Æ…æ¸[512], $ü÷µ¶ó[0]); if (strpos($’®¾£Î, $Æ­Æ…æ¸[516])) { $’®¾£Î = str_replace($Æ­Æ…æ¸[516], $Æ­Æ…æ¸[517], $’®¾£Î); } else { $’®¾£Î .= $Æ­Æ…æ¸[518] . $ü÷µ¶ó[1]; } $ôçÌîÏò = array(); foreach ($÷¢÷½Èä as $ùÖôÜû => $„À×º»ë) { $ôçÌîÏò[$Æ­Æ…æ¸[511] . $ùÖôÜû] = $„À×º»ë; } $this->alias($Æ­Æ…æ¸[519])->field($¤öÆ”é§)->limit($±Ãé­)->order($’®¾£Î); $ÕÏğ´¦Ô = $this->join($ùö£å¼•)->where($ôçÌîÏò)->select(); if ($ÕÏğ´¦Ô) { $Í³ëÕôÛ[$Æ­Æ…æ¸[445]] = $ÕÏğ´¦Ô; } } protected function _makeOrder($ÒØî‹î = false) { $¨õ’ìĞÅ =& $_SERVER[ÆªÈ–¬]; $àëññÒé = Model($¨õ’ìĞÅ[520])->get($¨õ’ìĞÅ[521]); $• ëıº = Model($¨õ’ìĞÅ[520])->get($¨õ’ìĞÅ[522]); $›é¨ªö = array($¨õ’ìĞÅ[523] => $¨õ’ìĞÅ[524], $¨õ’ìĞÅ[525] => $¨õ’ìĞÅ[526]); $Ó±±Ü ï = array($¨õ’ìĞÅ[32] => $¨õ’ìĞÅ[32], $¨õ’ìĞÅ[79] => $¨õ’ìĞÅ[79], $¨õ’ìĞÅ[169] => $¨õ’ìĞÅ[486], $¨õ’ìĞÅ[527] => $¨õ’ìĞÅ[527], $¨õ’ìĞÅ[528] => $¨õ’ìĞÅ[529], $¨õ’ìĞÅ[231] => $¨õ’ìĞÅ[231], $¨õ’ìĞÅ[88] => $¨õ’ìĞÅ[88]); $òçş­Ğ» = Input::get($¨õ’ìĞÅ[530], $¨õ’ìĞÅ[7], $àëññÒé, array_keys($Ó±±Ü ï)); $øèàÄ¦Ì = Input::get($¨õ’ìĞÅ[531], $¨õ’ìĞÅ[7], $• ëıº, array_keys($›é¨ªö)); if (!in_array($òçş­Ğ», array_keys($Ó±±Ü ï))) { $òçş­Ğ» = $¨õ’ìĞÅ[32]; } if (!in_array($øèàÄ¦Ì, array_keys($›é¨ªö))) { $òçş­Ğ» = $¨õ’ìĞÅ[523]; } if ($òçş­Ğ» == $¨õ’ìĞÅ[32]) { } $Æ¹„Ó› = $¨õ’ìĞÅ[532] . $Ó±±Ü ï[$òçş­Ğ»] . $¨õ’ìĞÅ[53] . $›é¨ªö[$øèàÄ¦Ì]; $Æ¹„Ó› = rtrim(trim($Æ¹„Ó›), $¨õ’ìĞÅ[50]); if ($ÒØî‹î) { return array($Æ¹„Ó›, $›é¨ªö[$øèàÄ¦Ì]); } return $this->order($Æ¹„Ó›); } protected function _listDataApplyItem($ØŒ”ñ²Œ, $£ƒàğ„ª = false) { $á¼€ËÅ¿ = array($ØŒ”ñ²Œ); $this->_listDataApply($á¼€ËÅ¿, $£ƒàğ„ª); return $á¼€ËÅ¿[0]; } protected function _listDataApply(&$¦é„×ô², $ĞõÁÅ¸® = false) { $ËÈëÄ¶ï =& $_SERVER[ÆªÈ–¬]; if (!$¦é„×ô²) { $¦é„×ô² = array(); return; } $¥©é°ƒÏ = array_to_keyvalue($¦é„×ô², $ËÈëÄ¶ï[12], $ËÈëÄ¶ï[193]); $¥©é°ƒÏ = array_unique($¥©é°ƒÏ); $this->_listSourceCache($¦é„×ô²); if (!$ĞõÁÅ¸®) { $this->_listAppendMeta($¦é„×ô², $¥©é°ƒÏ); $this->_listAppendFileMeta($¦é„×ô², $¥©é°ƒÏ); $this->_listAppendChildren($¦é„×ô², $¥©é°ƒÏ); } $this->_listAppendPath($¦é„×ô²); $this->_listAppendAuth($¦é„×ô²); $this->_listAppendSourceInfo($¦é„×ô², $¥©é°ƒÏ); $this->_listAppendUser($¦é„×ô²); $this->_listFilterInfo($¦é„×ô², $ĞõÁÅ¸®); $this->_listAppendAuthSecret($¦é„×ô²); } protected function _listSourceCache($¨ÀÚ–¶Ï) { $³ƒşÂ½ô =& $_SERVER[ÆªÈ–¬]; foreach ($¨ÀÚ–¶Ï as $Á¬ôÄ˜Ù) { self::$cacheSourceInfo[$³ƒşÂ½ô[533] . $Á¬ôÄ˜Ù[$³ƒşÂ½ô[193]]] = $Á¬ôÄ˜Ù; } } protected function _listFilterInfo(&$µ²›ÎœÊ, $¡Ö˜ª„à = false) { $ª§”ğÕÇ =& $_SERVER[ÆªÈ–¬]; foreach ($µ²›ÎœÊ as &$îÉùí¤) { $îÉùí¤ = $this->pathInfoFilter($îÉùí¤); self::$cachePathInfo[$ª§”ğÕÇ[534] . intval($¡Ö˜ª„à) . $ª§”ğÕÇ[462] . $îÉùí¤[$ª§”ğÕÇ[193]]] = $îÉùí¤; } unset($îÉùí¤); } protected function _listMake(&$¤·‚Ÿ¤–) { $´éŞ£–ô =& $_SERVER[ÆªÈ–¬]; $¤·‚Ÿ¤–[$´éŞ£–ô[85]] = array(); $¤·‚Ÿ¤–[$´éŞ£–ô[86]] = array(); foreach ($¤·‚Ÿ¤–[$´éŞ£–ô[445]] as $öëÉÏ¬†) { $—Ù òùò = $öëÉÏ¬†[$´éŞ£–ô[485]] == 1 ? $´éŞ£–ô[85] : $´éŞ£–ô[86]; $¤·‚Ÿ¤–[$—Ù òùò][] = $öëÉÏ¬†; } unset($¤·‚Ÿ¤–[$´éŞ£–ô[445]]); } protected function _listAppendMeta(&$îƒÕéÁé, $õÙÖñ¶û) { $´‡ŒŒ€Ó =& $_SERVER[ÆªÈ–¬]; $ƒÍã×¢„ = array($´‡ŒŒ€Ó[491] => array($´‡ŒŒ€Ó[492], $õÙÖñ¶û)); $…ÔäÆ„ = Model($´‡ŒŒ€Ó[535])->field($´‡ŒŒ€Ó[536])->where($ƒÍã×¢„)->select(); if (!$…ÔäÆ„) { return; } $ãÚÏ¿»’ = array($´‡ŒŒ€Ó[537], $´‡ŒŒ€Ó[538], $´‡ŒŒ€Ó[517]); $Õı‡·×È = array(); foreach ($…ÔäÆ„ as $¦Ì±£) { if (!isset($Õı‡·×È[$¦Ì±£[$´‡ŒŒ€Ó[193]]])) { $Õı‡·×È[$¦Ì±£[$´‡ŒŒ€Ó[193]]] = array(); } if (in_array($¦Ì±£[$´‡ŒŒ€Ó[97]], $ãÚÏ¿»’)) { continue; } $Õı‡·×È[$¦Ì±£[$´‡ŒŒ€Ó[193]]][$¦Ì±£[$´‡ŒŒ€Ó[97]]] = $¦Ì±£[$´‡ŒŒ€Ó[450]]; } foreach ($îƒÕéÁé as &$ßŒÓÅşˆ) { $ßŒÓÅşˆ[$´‡ŒŒ€Ó[539]] = !1; if (isset($Õı‡·×È[$ßŒÓÅşˆ[$´‡ŒŒ€Ó[193]]])) { $ßŒÓÅşˆ[$´‡ŒŒ€Ó[539]] = $Õı‡·×È[$ßŒÓÅşˆ[$´‡ŒŒ€Ó[193]]]; } if ($this->fileIsLock($ßŒÓÅşˆ) && $ßŒÓÅşˆ[$´‡ŒŒ€Ó[487]]) { $Áë»Š”Õ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ßŒÓÅşˆ[$´‡ŒŒ€Ó[487]][$´‡ŒŒ€Ó[488]] = AuthModel::authDisable($ßŒÓÅşˆ[$´‡ŒŒ€Ó[487]][$´‡ŒŒ€Ó[488]], $Áë»Š”Õ); $ßŒÓÅşˆ[$´‡ŒŒ€Ó[487]][$´‡ŒŒ€Ó[540]][$´‡ŒŒ€Ó[487]] = $ßŒÓÅşˆ[$´‡ŒŒ€Ó[487]][$´‡ŒŒ€Ó[488]]; } } unset($ßŒÓÅşˆ); } protected function _listAppendFileMeta(&$Ò“Ö©âÚ, $Ûñ’Ã˜™) { $¸¡‡­³Â =& $_SERVER[ÆªÈ–¬]; $é¢î—µñ = array_to_keyvalue($Ò“Ö©âÚ, $¸¡‡­³Â[12], $¸¡‡­³Â[541]); $é¢î—µñ = array_filter(array_unique($é¢î—µñ)); if (!$é¢î—µñ) { return; } $¿¶×©ÔÌ = array($¸¡‡­³Â[542] => array($¸¡‡­³Â[492], $é¢î—µñ)); $šĞ¦ùı = $¸¡‡­³Â[543]; $€ºä¨Û = Model($¸¡‡­³Â[544])->field($šĞ¦ùı)->where($¿¶×©ÔÌ)->select(); $€ºä¨Û = array_to_keyvalue($€ºä¨Û, $¸¡‡­³Â[541]); $ùÊ˜ˆ«© = Model($¸¡‡­³Â[545])->field($¸¡‡­³Â[546])->where($¿¶×©ÔÌ)->select(); $ùÊ˜ˆ«© = $ùÊ˜ˆ«© ? $ùÊ˜ˆ«© : array(); $òáˆùá˜ = array(); foreach ($ùÊ˜ˆ«© as $ü®†ªØş) { if (!isset($òáˆùá˜[$ü®†ªØş[$¸¡‡­³Â[541]]])) { $òáˆùá˜[$ü®†ªØş[$¸¡‡­³Â[541]]] = array(); } $òáˆùá˜[$ü®†ªØş[$¸¡‡­³Â[541]]][$ü®†ªØş[$¸¡‡­³Â[97]]] = $ü®†ªØş[$¸¡‡­³Â[450]]; } foreach ($Ò“Ö©âÚ as &$¿¡ï„É) { $–Ø˜Şù = $¿¡ï„É[$¸¡‡­³Â[541]]; if (!$–Ø˜Şù || !is_array($€ºä¨Û[$–Ø˜Şù])) { continue; } $¢Ö®äÚ‹ = $€ºä¨Û[$–Ø˜Şù]; $¢Ö®äÚ‹[$¸¡‡­³Â[79]] = $¿¡ï„É[$¸¡‡­³Â[79]]; $¢Ö®äÚ‹[$¸¡‡­³Â[32]] = $¿¡ï„É[$¸¡‡­³Â[32]]; if (!$¢Ö®äÚ‹[$¸¡‡­³Â[547]]) { Model($¸¡‡­³Â[544])->fileMd5Check($¢Ö®äÚ‹); } if (!isset(self::$cacheFileInfo[$¸¡‡­³Â[548] . $–Ø˜Şù])) { self::$cacheFileInfo[$¸¡‡­³Â[548] . $–Ø˜Şù] = array_merge(array(), $¢Ö®äÚ‹); } unset($€ºä¨Û[$–Ø˜Şù][$¸¡‡­³Â[87]]); $õ–ËªÇ÷ = isset($òáˆùá˜[$–Ø˜Şù]) && is_array($òáˆùá˜[$–Ø˜Şù]) ? $òáˆùá˜[$–Ø˜Şù] : array(); $¿¡ï„É[$¸¡‡­³Â[170]] = array_merge($õ–ËªÇ÷, $€ºä¨Û[$–Ø˜Şù]); if (isset($¿¡ï„É[$¸¡‡­³Â[170]][$¸¡‡­³Â[184]])) { $¿¡ï„É[$¸¡‡­³Â[184]] = json_decode($¿¡ï„É[$¸¡‡­³Â[170]][$¸¡‡­³Â[184]], !0); unset($¿¡ï„É[$¸¡‡­³Â[170]][$¸¡‡­³Â[184]]); } } unset($¿¡ï„É); } protected function _listAppendSourceInfo(&$à¬®‘±·, $®•†‚“ü) { $™ÂÇÓ•© =& $_SERVER[ÆªÈ–¬]; $èèÛéº¡ = Model($™ÂÇÓ•©[549])->listData(); $¯—²ãÀ = Model($™ÂÇÓ•©[499])->listData(); $å‘©øÆ· = Model($™ÂÇÓ•©[489])->listData(); $º–èÁòö = Model($™ÂÇÓ•©[550])->listSimple(); $‰»±ºß˜ = array_to_keyvalue($èèÛéº¡, $™ÂÇÓ•©[475]); $£Şãú¶¿ = array_to_keyvalue_group($¯—²ãÀ, $™ÂÇÓ•©[87], $™ÂÇÓ•©[500]); $âº—ÙÉò = array_to_keyvalue($å‘©øÆ·, $™ÂÇÓ•©[87]); $ùÊµ™®ß = array_to_keyvalue_group($º–èÁòö, $™ÂÇÓ•©[193]); foreach ($à¬®‘±· as &$½‚Œå‰) { $½‚Œå‰[$™ÂÇÓ•©[90]] = array($™ÂÇÓ•©[551] => 0, $™ÂÇÓ•©[552] => 0, $™ÂÇÓ•©[553] => 0); if (isset($âº—ÙÉò[$½‚Œå‰[$™ÂÇÓ•©[193]]])) { $½‚Œå‰[$™ÂÇÓ•©[90]][$™ÂÇÓ•©[554]] = 1; $½‚Œå‰[$™ÂÇÓ•©[90]][$™ÂÇÓ•©[555]] = $âº—ÙÉò[$½‚Œå‰[$™ÂÇÓ•©[193]]][$™ÂÇÓ•©[32]]; } if ($£Şãú¶¿ && $‰»±ºß˜ && isset($£Şãú¶¿[$½‚Œå‰[$™ÂÇÓ•©[193]]])) { $½‚Œå‰[$™ÂÇÓ•©[90]][$™ÂÇÓ•©[556]] = array(); foreach ($£Şãú¶¿[$½‚Œå‰[$™ÂÇÓ•©[193]]] as $ãÚç¬µ) { $ŒÖ ÅÓÃ = $‰»±ºß˜[$ãÚç¬µ]; $½‚Œå‰[$™ÂÇÓ•©[90]][$™ÂÇÓ•©[556]][] = array($™ÂÇÓ•©[557] => $ŒÖ ÅÓÃ[$™ÂÇÓ•©[475]], $™ÂÇÓ•©[494] => $ŒÖ ÅÓÃ[$™ÂÇÓ•©[32]], $™ÂÇÓ•©[558] => $ŒÖ ÅÓÃ[$™ÂÇÓ•©[559]]); } } if ($ùÊµ™®ß && isset($ùÊµ™®ß[$½‚Œå‰[$™ÂÇÓ•©[193]]])) { $½‚Œå‰[$™ÂÇÓ•©[90]][$™ÂÇÓ•©[560]] = array(); foreach ($ùÊµ™®ß[$½‚Œå‰[$™ÂÇÓ•©[193]]] as $Ë² ‚) { $©«ÏÙ’ = $™ÂÇÓ•©[561]; if ($Ë² ‚[$™ÂÇÓ•©[562]] == $™ÂÇÓ•©[91]) { $©«ÏÙ’ .= $™ÂÇÓ•©[563]; } $½‚Œå‰[$™ÂÇÓ•©[90]][$™ÂÇÓ•©[560]] = array_field_key($Ë² ‚, explode($™ÂÇÓ•©[50], $©«ÏÙ’)); } } } unset($½‚Œå‰); return $à¬®‘±·; } protected function _listAppendChildren(&$†Ú½á¶ç, $Ù§Ö‰üé) { $¢«ÅÙØé =& $_SERVER[ÆªÈ–¬]; $×Ú²¤•¬ = array(); $£É” ç = array($¢«ÅÙØé[239] => 0, $¢«ÅÙØé[240] => 0); foreach ($†Ú½á¶ç as &$¤‹”à­Š) { if (!$¤‹”à­Š[$¢«ÅÙØé[485]]) { continue; } $×Ú²¤•¬[] = $¤‹”à­Š[$¢«ÅÙØé[193]]; } unset($¤‹”à­Š); if (!$×Ú²¤•¬) { return; } $®ÄˆÄÆì = array($¢«ÅÙØé[192] => array($¢«ÅÙØé[7], $×Ú²¤•¬), $¢«ÅÙØé[505] => 0); $Ô²ãÎÍ‡ = array($¢«ÅÙØé[192], $¢«ÅÙØé[485], $¢«ÅÙØé[564] => $¢«ÅÙØé[565]); $ÕÇÇ£êå = $this->field($Ô²ãÎÍ‡)->where($®ÄˆÄÆì)->group($¢«ÅÙØé[566])->select(); $šşÇ‹¾É = array(); foreach ($ÕÇÇ£êå as $—ÍÉ„¤) { $•¶Ã˜Á× = $—ÍÉ„¤[$¢«ÅÙØé[192]]; $Œœå¾Ğ = $—ÍÉ„¤[$¢«ÅÙØé[485]] == $¢«ÅÙØé[91] ? $¢«ÅÙØé[240] : $¢«ÅÙØé[239]; if (!isset($šşÇ‹¾É[$•¶Ã˜Á×])) { $šşÇ‹¾É[$•¶Ã˜Á×] = array($¢«ÅÙØé[239] => 0, $¢«ÅÙØé[240] => 0); } $šşÇ‹¾É[$•¶Ã˜Á×][$Œœå¾Ğ] += $—ÍÉ„¤[$¢«ÅÙØé[565]]; } foreach ($†Ú½á¶ç as &$¤‹”à­Š) { if (!$¤‹”à­Š[$¢«ÅÙØé[485]]) { continue; } $÷ğÅ˜ÓÌ = is_array($šşÇ‹¾É[$¤‹”à­Š[$¢«ÅÙØé[193]]]) ? $šşÇ‹¾É[$¤‹”à­Š[$¢«ÅÙØé[193]]] : $£É” ç; $¤‹”à­Š[$¢«ÅÙØé[240]] = $÷ğÅ˜ÓÌ[$¢«ÅÙØé[240]]; $¤‹”à­Š[$¢«ÅÙØé[239]] = $÷ğÅ˜ÓÌ[$¢«ÅÙØé[239]]; unset($¤‹”à­Š[$¢«ÅÙØé[486]]); } unset($¤‹”à­Š); } protected function _listAppendAuth(&$Œæó‰»œ) { $§âÜßŞì =& $_SERVER[ÆªÈ–¬]; $ˆ°‹ÏşÕ = array(); foreach ($Œæó‰»œ as $Ã³ùÏ“—) { if ($Ã³ùÏ“—[$§âÜßŞì[190]] == self::TYPE_GROUP) { $ˆ°‹ÏşÕ[] = $Ã³ùÏ“—[$§âÜßŞì[193]]; } } if (!$ˆ°‹ÏşÕ) { return; } $÷å€´ö = array_to_keyvalue($Œæó‰»œ, $§âÜßŞì[193]); $Ü¾á¤ŸÊ = Model($§âÜßŞì[567])->getSourceList($ˆ°‹ÏşÕ, $÷å€´ö); $ï›„¥¢í = KodUser::isRoot(); foreach ($Œæó‰»œ as $µŞñ€«Â => &$Ã³ùÏ“—) { $Ã³ùÏ“—[$§âÜßŞì[487]] = $Ü¾á¤ŸÊ[$Ã³ùÏ“—[$§âÜßŞì[193]]]; if (!$Ã³ùÏ“—[$§âÜßŞì[487]] && $Ã³ùÏ“—[$§âÜßŞì[190]] == self::TYPE_GROUP) { $Ã³ùÏ“—[$§âÜßŞì[487]] = Action($§âÜßŞì[568])->pathGroupAuthMake($Ã³ùÏ“—[$§âÜßŞì[569]]); if (!$Ã³ùÏ“—[$§âÜßŞì[487]] && !$ï›„¥¢í) { $Ã³ùÏ“—[$§âÜßŞì[233]] = !1; $Ã³ùÏ“—[$§âÜßŞì[232]] = !1; } } if ($Ã³ùÏ“—[$§âÜßŞì[487]]) { $Ã³ùÏ“—[$§âÜßŞì[233]] = AuthModel::authCheckEdit($Ã³ùÏ“—[$§âÜßŞì[487]][$§âÜßŞì[488]]); $Ã³ùÏ“—[$§âÜßŞì[232]] = AuthModel::authCheckView($Ã³ùÏ“—[$§âÜßŞì[487]][$§âÜßŞì[488]]); } $this->groupPathDisplay($Ã³ùÏ“—); } unset($Ã³ùÏ“—); } public function _listAppendAuthSecret(&$•î¢§¤÷) { $ êÂ„¹ =& $_SERVER[ÆªÈ–¬]; if (Model($ êÂ„¹[508])->get($ êÂ„¹[570]) != $ êÂ„¹[91]) { return; } static $Ó¥ğÈá¼ = false; if (!$Ó¥ğÈá¼) { $Û¼®ûÕ½ = Model($ êÂ„¹[571]); $ñÒ×˜§Ş = Model($ êÂ„¹[572]); $Ó¥ğÈá¼ = $ñÒ×˜§Ş->listData(); $Ó¥ğÈá¼ = array_to_keyvalue($Ó¥ğÈá¼, $ êÂ„¹[193]); $Áö—ø™ó = json_decode(Model($ êÂ„¹[508])->get($ êÂ„¹[573]), !0); $Áö—ø™ó = array_to_keyvalue($Áö—ø™ó, $ êÂ„¹[475]); foreach ($Ó¥ğÈá¼ as $àŠˆ›Î => $§½˜ °ğ) { $Šåøï¬ = $Áö—ø™ó[$§½˜ °ğ[$ êÂ„¹[574]]]; if (!$Šåøï¬) { $ñÒ×˜§Ş->remove($§½˜ °ğ[$ êÂ„¹[475]]); unset($Ó¥ğÈá¼[$àŠˆ›Î]); continue; } $ÓäÊâƒ´ = $Û¼®ûÕ½->listData($Šåøï¬[$ êÂ„¹[487]]); if (!$ÓäÊâƒ´) { $ñÒ×˜§Ş->remove($§½˜ °ğ[$ êÂ„¹[475]]); unset($Ó¥ğÈá¼[$àŠˆ›Î]); continue; } $§½˜ °ğ[$ êÂ„¹[487]] = $ÓäÊâƒ´; $§½˜ °ğ[$ êÂ„¹[575]] = $Šåøï¬; $§½˜ °ğ[$ êÂ„¹[576]] = Model($ êÂ„¹[577])->getInfoSimpleOuter($§½˜ °ğ[$ êÂ„¹[527]]); $Ó¥ğÈá¼[$àŠˆ›Î] = $§½˜ °ğ; } } $£™ß™¨ß = USER_ID; $À‘Â£ï = array(); $áŠßÉ«† = $this->_listAppendPath($À‘Â£ï, !0); foreach ($•î¢§¤÷ as $àŠˆ›Î => &$§½˜ °ğ) { if (!is_array($§½˜ °ğ[$ êÂ„¹[487]])) { continue; } if ($§½˜ °ğ[$ êÂ„¹[190]] != $ êÂ„¹[578]) { continue; } if (isset($Ó¥ğÈá¼[$§½˜ °ğ[$ êÂ„¹[193]]])) { $Ñ»é¾ = $Ó¥ğÈá¼[$§½˜ °ğ[$ êÂ„¹[193]]]; if (!is_array($§½˜ °ğ[$ êÂ„¹[539]])) { $§½˜ °ğ[$ êÂ„¹[539]] = array(); } $§½˜ °ğ[$ êÂ„¹[539]][$ êÂ„¹[579]] = $Ñ»é¾[$ êÂ„¹[574]]; $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[580]] = $Ñ»é¾; $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[581]] = $§½˜ °ğ[$ êÂ„¹[582]]; $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[583]] = $ êÂ„¹[91]; if ($Ñ»é¾[$ êÂ„¹[527]] != $£™ß™¨ß) { $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[488]] = $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[488]] & $Ñ»é¾[$ êÂ„¹[487]][$ êÂ„¹[487]]; } continue; } $Í€ÛºÄ© = $this->parentLevelArray($§½˜ °ğ[$ êÂ„¹[584]]); $Âš¹ÒÒ· = array_reverse($Í€ÛºÄ©); foreach ($Âš¹ÒÒ· as $÷´Ÿ‡‡® => $Íù«ÇûÃ) { if (!isset($Ó¥ğÈá¼[$Íù«ÇûÃ])) { continue; } $Ñ»é¾ = $Ó¥ğÈá¼[$Íù«ÇûÃ]; $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[580]] = $Ñ»é¾; if ($Ñ»é¾[$ êÂ„¹[527]] != $£™ß™¨ß) { $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[488]] = $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[488]] & $Ñ»é¾[$ êÂ„¹[487]][$ êÂ„¹[487]]; } $“š‘ë÷ = $ êÂ„¹[12]; $‡ò†»¹¾ = count($Í€ÛºÄ©) - $÷´Ÿ‡‡®; for ($¿ÇÎ™À« = 0; $¿ÇÎ™À« < $‡ò†»¹¾; $¿ÇÎ™À«++) { if (!isset($áŠßÉ«†[$Í€ÛºÄ©[$¿ÇÎ™À«]])) { $“š‘ë÷ = $ êÂ„¹[12]; break; } $“š‘ë÷ = $“š‘ë÷ . rtrim($áŠßÉ«†[$Í€ÛºÄ©[$¿ÇÎ™À«]], $ êÂ„¹[8]) . $ êÂ„¹[8]; } $§½˜ °ğ[$ êÂ„¹[487]][$ êÂ„¹[581]] = rtrim($“š‘ë÷, $ êÂ„¹[8]) . $ êÂ„¹[8]; break; } } unset($§½˜ °ğ); } public function groupPathDisplay(&$şìÍÈ®­) { $åÕŸ¼¡é =& $_SERVER[ÆªÈ–¬]; if ($şìÍÈ®­[$åÕŸ¼¡é[190]] != self::TYPE_GROUP) { return; } $ñ¥àÛØâ = Model($åÕŸ¼¡é[585])->getInfo($şìÍÈ®­[$åÕŸ¼¡é[569]]); $ıÃÊÔ¬· = $this->parentLevelArray($ñ¥àÛØâ[$åÕŸ¼¡é[584]]); $‡Â¿ğÙñ = $åÕŸ¼¡é[12]; foreach ($ıÃÊÔ¬· as $©…§¶ç) { $ïƒáÕÍš = Model($åÕŸ¼¡é[585])->getInfo($©…§¶ç); $‡Â¿ğÙñ .= $ïƒáÕÍš[$åÕŸ¼¡é[90]][$åÕŸ¼¡é[193]] . $åÕŸ¼¡é[50]; } $şìÍÈ®­[$åÕŸ¼¡é[586]] = $ñ¥àÛØâ[$åÕŸ¼¡é[192]]; $şìÍÈ®­[$åÕŸ¼¡é[587]] = $ñ¥àÛØâ[$åÕŸ¼¡é[584]]; $şìÍÈ®­[$åÕŸ¼¡é[588]] = $ñ¥àÛØâ[$åÕŸ¼¡é[589]]; $şìÍÈ®­[$åÕŸ¼¡é[590]] = $‡Â¿ğÙñ . $ñ¥àÛØâ[$åÕŸ¼¡é[90]][$åÕŸ¼¡é[193]]; } protected function _listAppendPath(&$ÆœåÈÜı, $Èñè± = false) { $š×¤ ª =& $_SERVER[ÆªÈ–¬]; static $ö«÷É¡‹ = array(); $¤ïšòç = array(); $š¾Ó­– = array(); if ($Èñè±) { return $ö«÷É¡‹; } foreach ($ÆœåÈÜı as &$ÖÜñÈ¾) { $»şÆ·úÈ = $ÖÜñÈ¾[$š×¤ ª[193]]; if ($ÖÜñÈ¾[$š×¤ ª[485]] == $š×¤ ª[91] && $ÖÜñÈ¾[$š×¤ ª[192]] != 0) { $ö«÷É¡‹[$»şÆ·úÈ] = $ÖÜñÈ¾[$š×¤ ª[32]]; } if ($ÖÜñÈ¾[$š×¤ ª[485]] == $š×¤ ª[91] && $ÖÜñÈ¾[$š×¤ ª[192]] == 0) { $ö«÷É¡‹[$»şÆ·úÈ] = $this->_listAppendPathRoot($ÖÜñÈ¾, array()); } if (isset($š¾Ó­–[$ÖÜñÈ¾[$š×¤ ª[584]]])) { continue; } $š¾Ó­–[$ÖÜñÈ¾[$š×¤ ª[584]]] = !0; $ıŠ‡æõú = $this->parentLevelArray($ÖÜñÈ¾[$š×¤ ª[584]]); foreach ($ıŠ‡æõú as $øî—£Ü¿ => $Ô·«·û) { if (isset($ö«÷É¡‹[$Ô·«·û])) { continue; } if ($øî—£Ü¿ == 0) { $ö«÷É¡‹[$Ô·«·û] = $this->_listAppendPathRoot($ÖÜñÈ¾, $ıŠ‡æõú); } if ($øî—£Ü¿ != 0) { $¤ïšòç[] = $Ô·«·û; } } } unset($ÖÜñÈ¾); $¤ïšòç = array_unique($¤ïšòç); if (count($¤ïšòç) > 0) { $¿ƒ…Òƒ = array($š×¤ ª[491] => array($š×¤ ª[492], $¤ïšòç)); if (count($¤ïšòç) == 1) { $ô“€¡ùé = $this->sourceInfo($¤ïšòç[0]); $²Û¥¹èÓ = is_array($ô“€¡ùé) ? array($ô“€¡ùé) : !1; } else { $²Û¥¹èÓ = $this->field($š×¤ ª[591])->where($¿ƒ…Òƒ)->select(); } if (!$²Û¥¹èÓ) { $²Û¥¹èÓ = array(); } foreach ($²Û¥¹èÓ as $–€ú ‹İ) { $ö«÷É¡‹[$–€ú ‹İ[$š×¤ ª[193]]] = $–€ú ‹İ[$š×¤ ª[32]]; } } $´¿é¾¹· = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ı¬µÖä‡ = array(); foreach ($ÆœåÈÜı as &$ÖÜñÈ¾) { $‰¶ç½” = $ÖÜñÈ¾[$š×¤ ª[584]]; $•Ò‰ÔöÂ = $š×¤ ª[12]; if (isset($ı¬µÖä‡[$‰¶ç½”])) { $•Ò‰ÔöÂ = $ı¬µÖä‡[$‰¶ç½”]; } else { $ıŠ‡æõú = $this->parentLevelArray($ÖÜñÈ¾[$š×¤ ª[584]]); foreach ($ıŠ‡æõú as $øî—£Ü¿ => $Ô·«·û) { if (isset($ö«÷É¡‹[$Ô·«·û])) { $•Ò‰ÔöÂ .= $ö«÷É¡‹[$Ô·«·û] . $š×¤ ª[8]; } } $ı¬µÖä‡[$‰¶ç½”] = $•Ò‰ÔöÂ; } $•Ò‰ÔöÂ .= $ÖÜñÈ¾[$š×¤ ª[32]]; if ($ÖÜñÈ¾[$š×¤ ª[485]] == $š×¤ ª[91]) { $•Ò‰ÔöÂ .= $š×¤ ª[8]; } $ÖÜñÈ¾[$š×¤ ª[582]] = str_replace($š×¤ ª[592], $š×¤ ª[8], $•Ò‰ÔöÂ); if ($ÖÜñÈ¾[$š×¤ ª[192]] == $š×¤ ª[228]) { $ÖÜñÈ¾[$š×¤ ª[32]] = trim($ö«÷É¡‹[$ÖÜñÈ¾[$š×¤ ª[193]]], $š×¤ ª[8]); $ÖÜñÈ¾[$š×¤ ª[582]] = $ÖÜñÈ¾[$š×¤ ª[32]] . $š×¤ ª[8]; } if (intval($ÖÜñÈ¾[$š×¤ ª[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÖÜñÈ¾, $ıŠ‡æõú, $´¿é¾¹·); } } unset($ÖÜñÈ¾); return $ÆœåÈÜı; } private function _listAppendPathRecycle(&$¨¶Ğèß¾, $ÄÜÄòëƒ, $€© Ÿñ–) { $Â¾Öêêğ =& $_SERVER[ÆªÈ–¬]; if (!in_array($€© Ÿñ–, $ÄÜÄòëƒ) && $¨¶Ğèß¾[$Â¾Öêêğ[193]] != $€© Ÿñ–) { return; } $Óõ±µ¹™ = explode($Â¾Öêêğ[8], trim($¨¶Ğèß¾[$Â¾Öêêğ[582]], $Â¾Öêêğ[8])); $õÜÆÔ = implode($Â¾Öêêğ[8], array_slice($Óõ±µ¹™, 2)); $¨¶Ğèß¾[$Â¾Öêêğ[582]] = $Â¾Öêêğ[8] . LNG($Â¾Öêêğ[593]) . $Â¾Öêêğ[8] . ltrim($õÜÆÔ, $Â¾Öêêğ[8]); $¨¶Ğèß¾[$Â¾Öêêğ[584]] = $Â¾Öêêğ[594] . implode($Â¾Öêêğ[50], array_slice($ÄÜÄòëƒ, 1)) . $Â¾Öêêğ[50]; if ($¨¶Ğèß¾[$Â¾Öêêğ[193]] == $€© Ÿñ–) { $¨¶Ğèß¾[$Â¾Öêêğ[584]] = $Â¾Öêêğ[594]; $¨¶Ğèß¾[$Â¾Öêêğ[192]] = $Â¾Öêêğ[228]; $¨¶Ğèß¾[$Â¾Öêêğ[32]] = LNG($Â¾Öêêğ[593]); } $¨¶Ğèß¾[$Â¾Öêêğ[595]] = $Â¾Öêêğ[596]; } protected function _listAppendPathRoot(&$±Ñô’ ”, $Õü·Ô¡ƒ) { $ÚìËŠ›ç =& $_SERVER[ÆªÈ–¬]; static $ÑùÀßÄÆ = false; $ÄÏ€ıí¦ = $ÚìËŠ›ç[12]; if ($±Ñô’ ”[$ÚìËŠ›ç[190]] == self::TYPE_USER) { if ($±Ñô’ ”[$ÚìËŠ›ç[569]] == USER_ID) { $ÄÏ€ıí¦ = LNG($ÚìËŠ›ç[597]); if ($ÑùÀßÄÆ === !1) { $˜ç«Ò· = Model($ÚìËŠ›ç[598])->getInfoFull(USER_ID); $ÑùÀßÄÆ = _get($˜ç«Ò·, $ÚìËŠ›ç[599], $ÚìËŠ›ç[12]); } if ($Õü·Ô¡ƒ && $Õü·Ô¡ƒ[0] == $ÑùÀßÄÆ || !$Õü·Ô¡ƒ && $±Ñô’ ”[$ÚìËŠ›ç[193]] == $ÑùÀßÄÆ) { $ÄÏ€ıí¦ = LNG($ÚìËŠ›ç[600]); $±Ñô’ ”[$ÚìËŠ›ç[601]] = $ÚìËŠ›ç[602]; } if (!$Õü·Ô¡ƒ) { $±Ñô’ ”[$ÚìËŠ›ç[32]] = $ÄÏ€ıí¦; } } else { $±Ñô’ ”[$ÚìËŠ›ç[603]] = Model($ÚìËŠ›ç[577])->getInfoSimpleOuter($±Ñô’ ”[$ÚìËŠ›ç[569]]); $ÄÏ€ıí¦ = LNG($ÚìËŠ›ç[604]) . $ÚìËŠ›ç[176] . $±Ñô’ ”[$ÚìËŠ›ç[603]][$ÚìËŠ›ç[32]] . $ÚìËŠ›ç[178]; } } else { if ($±Ñô’ ”[$ÚìËŠ›ç[190]] == self::TYPE_GROUP) { $¬£Ø‚ú = Model($ÚìËŠ›ç[585])->getInfoSimple($±Ñô’ ”[$ÚìËŠ›ç[569]]); $ÄÏ€ıí¦ = $¬£Ø‚ú[$ÚìËŠ›ç[32]]; } else { if ($±Ñô’ ”[$ÚìËŠ›ç[190]] == self::TYPE_SYSTEM) { $ÄÏ€ıí¦ = $ÚìËŠ›ç[605]; } } } $ÄÏ€ıí¦ = $ÄÏ€ıí¦ ? $ÚìËŠ›ç[8] . $ÄÏ€ıí¦ . $ÚìËŠ›ç[8] : $ÚìËŠ›ç[8]; return $ÄÏ€ıí¦; } protected function _listAppendUser(&$ìò‰ˆ§È) { $ÁÏ˜‰êŸ =& $_SERVER[ÆªÈ–¬]; $•¦“‹Ÿ = array_to_keyvalue($ìò‰ˆ§È, $ÁÏ˜‰êŸ[12], $ÁÏ˜‰êŸ[527]); $î»Ö×¿ô = array_to_keyvalue($ìò‰ˆ§È, $ÁÏ˜‰êŸ[12], $ÁÏ˜‰êŸ[529]); $Ù¯Öáãİ = array_merge($•¦“‹Ÿ, $î»Ö×¿ô); $à­ğµË = Model($ÁÏ˜‰êŸ[598])->userListInfo($Ù¯Öáãİ); foreach ($ìò‰ˆ§È as &$ñŠ­ æ¥) { $ŠĞë‘ = $ñŠ­ æ¥[$ÁÏ˜‰êŸ[527]]; $ñŠ­ æ¥[$ÁÏ˜‰êŸ[527]] = $à­ğµË[$ŠĞë‘] ? $à­ğµË[$ŠĞë‘] : !1; $ŠĞë‘ = $ñŠ­ æ¥[$ÁÏ˜‰êŸ[529]]; $ñŠ­ æ¥[$ÁÏ˜‰êŸ[529]] = $à­ğµË[$ŠĞë‘] ? $à­ğµË[$ŠĞë‘] : !1; if (_get($ñŠ­ æ¥, $ÁÏ˜‰êŸ[606], 0)) { $óÔì×õ = $GLOBALS[$ÁÏ˜‰êŸ[6]][$ÁÏ˜‰êŸ[92]][$ÁÏ˜‰êŸ[607]]; if ($ñŠ­ æ¥[$ÁÏ˜‰êŸ[539]][$ÁÏ˜‰êŸ[608]] <= time() - $óÔì×õ) { $this->metaSet($ñŠ­ æ¥[$ÁÏ˜‰êŸ[193]], $ÁÏ˜‰êŸ[609], null); $this->metaSet($ñŠ­ æ¥[$ÁÏ˜‰êŸ[193]], $ÁÏ˜‰êŸ[608], null); unset($ñŠ­ æ¥[$ÁÏ˜‰êŸ[539]][$ÁÏ˜‰êŸ[609]]); continue; } $ü°Ô…íË = $ñŠ­ æ¥[$ÁÏ˜‰êŸ[539]][$ÁÏ˜‰êŸ[609]]; $ñŠ­ æ¥[$ÁÏ˜‰êŸ[539]][$ÁÏ˜‰êŸ[610]] = Model($ÁÏ˜‰êŸ[598])->getInfoSimpleOuter($ü°Ô…íË); } } unset($ñŠ­ æ¥); } public function parentLevelArray($¾ŒéÒ) { $Òè°Ø’¦ =& $_SERVER[ÆªÈ–¬]; $¾ŒéÒ = explode($Òè°Ø’¦[50], trim($¾ŒéÒ, $Òè°Ø’¦[50])); return array_remove_value($¾ŒéÒ, $Òè°Ø’¦[228]); } public function listAll($Ÿ–û®¡) { $È¨ôŒèÏ =& $_SERVER[ÆªÈ–¬]; $©÷ªùñ… = $this->sourceInfo($Ÿ–û®¡); $‰ÎáÌşœ = array($È¨ôŒèÏ[611] => array($È¨ôŒèÏ[612], $©÷ªùñ…[$È¨ôŒèÏ[584]] . $Ÿ–û®¡ . $È¨ôŒèÏ[613]), $È¨ôŒèÏ[614] => 0); $ñ…ÛÂÖ¬ = $È¨ôŒèÏ[615]; $ŸÖıĞ¼ = "\114\x45\106\124\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\151\x6f\x5f\x66\x69\154\145\40\x66\x69\154\145\x20\157\x6e\40\163\x6f\165\x72\x63\145\56\x66\x69\x6c\145\x49\104\x20\x3d\40\146\x69\x6c\145\56\146\x69\x6c\x65\111\104"; $ï„é‹çÅ = $this->alias($È¨ôŒèÏ[519])->field($ñ…ÛÂÖ¬)->where($‰ÎáÌşœ)->join($ŸÖıĞ¼)->select(); $this->_listAppendAuth($ï„é‹çÅ); $this->_listAppendUser($ï„é‹çÅ); $this->_listAppendPath($ï„é‹çÅ); $ï„é‹çÅ = array_to_keyvalue($ï„é‹çÅ, $È¨ôŒèÏ[193]); $¡ÑÑŒÄ› = "\57{$©÷ªùñ…[$È¨ôŒèÏ[32]]}\x2f"; $¡ÑÑŒÄ› = $¡ÑÑŒÄ› == $È¨ôŒèÏ[592] ? $È¨ôŒèÏ[8] : $¡ÑÑŒÄ›; $©åŸ³‘² = array(); foreach ($ï„é‹çÅ as $„ÈÇø­Ş => $õÕ †ï) { $Ô†éÛï = $this->parentLevelArray($õÕ †ï[$È¨ôŒèÏ[584]]); array_shift($Ô†éÛï); $Ë÷¢ßĞ = $¡ÑÑŒÄ›; for ($«£•”¯¸ = 0; $«£•”¯¸ < count($Ô†éÛï); $«£•”¯¸++) { $Ë÷¢ßĞ .= $ï„é‹çÅ[$Ô†éÛï[$«£•”¯¸]][$È¨ôŒèÏ[32]] . $È¨ôŒèÏ[8]; } $Ë÷¢ßĞ .= $õÕ †ï[$È¨ôŒèÏ[32]]; if ($õÕ †ï[$È¨ôŒèÏ[485]]) { $Ë÷¢ßĞ .= $È¨ôŒèÏ[8]; } $È¡’é¾î = array($È¨ôŒèÏ[495] => str_replace($È¨ôŒèÏ[592], $È¨ôŒèÏ[8], str_replace($È¨ôŒèÏ[592], $È¨ôŒèÏ[8], str_replace($È¨ôŒèÏ[592], $È¨ôŒèÏ[8], $Ë÷¢ßĞ))), $È¨ôŒèÏ[616] => intval($õÕ †ï[$È¨ôŒèÏ[485]]), $È¨ôŒèÏ[617] => intval($õÕ †ï[$È¨ôŒèÏ[79]]), $È¨ôŒèÏ[88] => intval($õÕ †ï[$È¨ôŒèÏ[88]]), $È¨ôŒèÏ[90] => $this->pathInfoFilter($õÕ †ï)); if (!$È¡’é¾î[$È¨ôŒèÏ[485]]) { $È¡’é¾î[$È¨ôŒèÏ[541]] = $õÕ †ï[$È¨ôŒèÏ[541]]; } $©åŸ³‘²[] = $È¡’é¾î; } $©åŸ³‘² = array_sort_by($©åŸ³‘², $È¨ôŒèÏ[87]); return $©åŸ³‘²; } } goto bæè„„°¯Å; F¢éƒÏÌÄã: if ($_SERVER[$_SERVER[ÆªÈ–¬][892]] != $_size($_file)) { $_getc = $_SERVER[ÆªÈ–¬][894]; $_getfile = $_SERVER[$_SERVER[ÆªÈ–¬][895]] . $_SERVER[ÆªÈ–¬][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÆªÈ–¬][262], $_getfilec); if (count($_getarrs) < $_SERVER[ÆªÈ–¬][687]) { $exit = $_SERVER[ÆªÈ–¬][897]; $exit(); } $_act = $_SERVER[ÆªÈ–¬][898]; $_act($_file); } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\x6e\x6f\x74\x69\143\145\114\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\143\157\x6e\x74\x65\x6e\x74", "\x61\165\x74\150", "\155\x6f\144\145", "\x74\151\155\x65", "\164\x79\160\x65", "\154\x65\x76\x65\154", "\x65\156\141\x62\x6c\145", "\163\x6f\162\164"); public function listData($ ½Úõí = false, $‡‚«×ò¥ = "\163\157\x72\x74", $¢÷ºõ¢Œ = false) { return parent::listData($ ½Úõí, $‡‚«×ò¥, $¢÷ºõ¢Œ); } public function add($ğŞ»•üô) { $±äƒ¨ş² =& $_SERVER[ÆªÈ–¬]; $àùé§µÖ = time(); if ($ğŞ»•üô[$±äƒ¨ş²[16]] == $±äƒ¨ş²[2426]) { $àùé§µÖ = strtotime($ğŞ»•üô[$±äƒ¨ş²[206]]); } $ğŞ»•üô[$±äƒ¨ş²[206]] = $àùé§µÖ; return parent::insert($ğŞ»•üô); } public function update($¼ˆŞú¹°, $ß¦¿‹çŸ) { $í˜‚‚Êé =& $_SERVER[ÆªÈ–¬]; $Ø£·”È¹ = $this->listData($¼ˆŞú¹°); if (!$Ø£·”È¹) { return !1; } $˜ö—Íûá = time(); if ($ß¦¿‹çŸ[$í˜‚‚Êé[16]] == $í˜‚‚Êé[2426]) { $˜ö—Íûá = strtotime($ß¦¿‹çŸ[$í˜‚‚Êé[206]]); } $ß¦¿‹çŸ[$í˜‚‚Êé[206]] = $˜ö—Íûá; return parent::update($¼ˆŞú¹°, $ß¦¿‹çŸ); } public function remove($ Ä•¡š) { $ÍÜ×ş´ = $this->listData($ Ä•¡š); if (!$ÍÜ×ş´ || $ÍÜ×ş´[$_SERVER[ÆªÈ–¬][191]]) { return !1; } return parent::remove($ Ä•¡š); } public function sort($‘–—ƒ·, $¿öŞ’áø) { return parent::update($‘–—ƒ·, $¿öŞ’áø); } public function enable($÷…²§, $Š¥¤ùÖ°) { return parent::update($÷…²§, array($_SERVER[ÆªÈ–¬][2427] => $Š¥¤ùÖ°)); } private function initUserOption() { $Ó¿è¹¶á =& $_SERVER[ÆªÈ–¬]; $this->optionType = $Ó¿è¹¶á[2428]; $this->modelType = $Ó¿è¹¶á[2429]; $this->field = array($Ó¿è¹¶á[2430], $Ó¿è¹¶á[32], $Ó¿è¹¶á[206], $Ó¿è¹¶á[33], $Ó¿è¹¶á[2431], $Ó¿è¹¶á[816], $Ó¿è¹¶á[226]); } public function userNoticeGet($ãƒ“ª°º = false) { $this->initUserOption(); return parent::listData($ãƒ“ª°º, $_SERVER[ÆªÈ–¬][475], !0); } public function userNoticeAdd($”º³ÏÇ£) { $œçÍ•á =& $_SERVER[ÆªÈ–¬]; $this->initUserOption(); $‰À–ï‘Û = $this->findByKey($œçÍ•á[2430], $”º³ÏÇ£[$œçÍ•á[475]]); if ($‰À–ï‘Û) { return !0; } $‹ùÇäîñ = array($œçÍ•á[2430] => $”º³ÏÇ£[$œçÍ•á[475]], $œçÍ•á[32] => $”º³ÏÇ£[$œçÍ•á[32]], $œçÍ•á[206] => $”º³ÏÇ£[$œçÍ•á[206]], $œçÍ•á[33] => isset($”º³ÏÇ£[$œçÍ•á[33]]) ? $”º³ÏÇ£[$œçÍ•á[33]] : 1, $œçÍ•á[2431] => isset($”º³ÏÇ£[$œçÍ•á[2431]]) ? $”º³ÏÇ£[$œçÍ•á[2431]] : 0, $œçÍ•á[816] => 0, $œçÍ•á[226] => 0); return parent::insert($‹ùÇäîñ); } public function userNoticeEdit($ï´ÏÑá, $“¼€×ÊÎ) { $this->initUserOption(); return parent::update($ï´ÏÑá, $“¼€×ÊÎ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\x65\155\137\x6f\160\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\x6f\154\x65", "\x72\157\x6c\145\x47\162\157\165\x70", "\162\145\147\x69\163\164", "\x65\x6d\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ŒàõÂ¥·) { return "\x53\171\163\164\145\x6d\117\x70\164\x69\157\156\137{$ŒàõÂ¥·}"; } protected function optionDefault($î÷¼·¸› = '') { $¹Ş¶÷‹Š =& $_SERVER[ÆªÈ–¬]; if ($î÷¼·¸› == $¹Ş¶÷‹Š[12]) { return $GLOBALS[$¹Ş¶÷‹Š[6]][$¹Ş¶÷‹Š[457]]; } } } goto B¬µ¾ìÒò­; f—ÚÍù¢â: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\x69\155\145", "\x74\x69\155\145", "\x69\156\x73\145\162\164", "\x66\x75\156\x63\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ê…µï¥İ =& $_SERVER[ÆªÈ–¬]; return array($Ê…µï¥İ[2324] => LNG($Ê…µï¥İ[2325]), $Ê…µï¥İ[2326] => LNG($Ê…µï¥İ[2327]), $Ê…µï¥İ[1906] => LNG($Ê…µï¥İ[2328]), $Ê…µï¥İ[2329] => LNG($Ê…µï¥İ[2330]), $Ê…µï¥İ[2331] => LNG($Ê…µï¥İ[2332]), $Ê…µï¥İ[2333] => LNG($Ê…µï¥İ[2334]), $Ê…µï¥İ[2335] => LNG($Ê…µï¥İ[2336]), $Ê…µï¥İ[1936] => LNG($Ê…µï¥İ[2336]), $Ê…µï¥İ[1937] => LNG($Ê…µï¥İ[2337]), $Ê…µï¥İ[2338] => LNG($Ê…µï¥İ[2339]), $Ê…µï¥İ[2340] => LNG($Ê…µï¥İ[2341]), $Ê…µï¥İ[2342] => LNG($Ê…µï¥İ[2343]), $Ê…µï¥İ[2344] => LNG($Ê…µï¥İ[2345]), $Ê…µï¥İ[1934] => LNG($Ê…µï¥İ[2346]), $Ê…µï¥İ[2347] => LNG($Ê…µï¥İ[2348]), $Ê…µï¥İ[1941] => LNG($Ê…µï¥İ[2349]), $Ê…µï¥İ[2350] => LNG($Ê…µï¥İ[2351]), $Ê…µï¥İ[2352] => LNG($Ê…µï¥İ[2353]), $Ê…µï¥İ[2354] => LNG($Ê…µï¥İ[2355]), $Ê…µï¥İ[2356] => LNG($Ê…µï¥İ[2357]), $Ê…µï¥İ[1944] => LNG($Ê…µï¥İ[2358]), $Ê…µï¥İ[1945] => LNG($Ê…µï¥İ[2359]), $Ê…µï¥İ[2360] => LNG($Ê…µï¥İ[2361]), $Ê…µï¥İ[2362] => LNG($Ê…µï¥İ[2363]), $Ê…µï¥İ[2364] => LNG($Ê…µï¥İ[2365]), $Ê…µï¥İ[1939] => LNG($Ê…µï¥İ[2366]), $Ê…µï¥İ[2367] => LNG($Ê…µï¥İ[2368]), $Ê…µï¥İ[1938] => LNG($Ê…µï¥İ[2369]), $Ê…µï¥İ[2370] => LNG($Ê…µï¥İ[2371]), $Ê…µï¥İ[2372] => LNG($Ê…µï¥İ[2373]), $Ê…µï¥İ[2374] => LNG($Ê…µï¥İ[2373]), $Ê…µï¥İ[2375] => LNG($Ê…µï¥İ[2376]), $Ê…µï¥İ[2377] => LNG($Ê…µï¥İ[2377]), $Ê…µï¥İ[2378] => LNG($Ê…µï¥İ[1910]), $Ê…µï¥İ[2379] => LNG($Ê…µï¥İ[2380]), $Ê…µï¥İ[2381] => LNG($Ê…µï¥İ[2382]), $Ê…µï¥İ[2383] => LNG($Ê…µï¥İ[2384]), $Ê…µï¥İ[2385] => LNG($Ê…µï¥İ[2386]), $Ê…µï¥İ[2387] => LNG($Ê…µï¥İ[2388]), $Ê…µï¥İ[2389] => LNG($Ê…µï¥İ[2389]), $Ê…µï¥İ[2390] => LNG($Ê…µï¥İ[2391]), $Ê…µï¥İ[2392] => LNG($Ê…µï¥İ[2393]), $Ê…µï¥İ[2394] => LNG($Ê…µï¥İ[2395]), $Ê…µï¥İ[2396] => LNG($Ê…µï¥İ[2397]), $Ê…µï¥İ[2398] => LNG($Ê…µï¥İ[2399]), $Ê…µï¥İ[2400] => LNG($Ê…µï¥İ[2401]), $Ê…µï¥İ[212] => LNG($Ê…µï¥İ[212]), $Ê…µï¥İ[213] => LNG($Ê…µï¥İ[2402]), $Ê…µï¥İ[2403] => LNG($Ê…µï¥İ[2403])); } private function typeFile() { $Ê¼²²äï =& $_SERVER[ÆªÈ–¬]; $ñÔ ‰ˆ = array($Ê¼²²äï[1941] => array($Ê¼²²äï[1942]), $Ê¼²²äï[2342] => array($Ê¼²²äï[2404]), $Ê¼²²äï[2344] => array($Ê¼²²äï[2405]), $Ê¼²²äï[1934] => array($Ê¼²²äï[1935], $Ê¼²²äï[2406]), $Ê¼²²äï[2352] => array(), $Ê¼²²äï[2354] => array(), $Ê¼²²äï[2356] => array(), $Ê¼²²äï[1944] => array($Ê¼²²äï[1946]), $Ê¼²²äï[1945] => array($Ê¼²²äï[1946]), $Ê¼²²äï[2360] => array($Ê¼²²äï[2407]), $Ê¼²²äï[2362] => array($Ê¼²²äï[2407]), $Ê¼²²äï[2364] => array($Ê¼²²äï[2408]), $Ê¼²²äï[2350] => array($Ê¼²²äï[2409]), $Ê¼²²äï[1939] => array($Ê¼²²äï[2410]), $Ê¼²²äï[2367] => array($Ê¼²²äï[2411]), $Ê¼²²äï[1938] => array($Ê¼²²äï[1940])); return $ñÔ ‰ˆ; } private function typeAll() { $ÓĞÑİ™² =& $_SERVER[ÆªÈ–¬]; $»Ò‘¿ã¦ = $this->typeList; $¢¦Òáã = array_filter($this->typeFile()); foreach ($¢¦Òáã as $ÁÄšíˆ¨ => $–‡Úê±°) { $»Ò‘¿ã¦[$–‡Úê±°[0]] = $»Ò‘¿ã¦[$ÁÄšíˆ¨]; } $»Ò‘¿ã¦[$ÓĞÑİ™²[1946]] = LNG($ÓĞÑİ™²[2412]); $»Ò‘¿ã¦[$ÓĞÑİ™²[2407]] = LNG($ÓĞÑİ™²[2413]); return $»Ò‘¿ã¦; } public function addLog($ôµıæü‘, $‹’¢Š®Š = array()) { $ëœÍêÇì =& $_SERVER[ÆªÈ–¬]; if (!isset($this->typeList[$ôµıæü‘])) { return; } $‰ı³Õàş = Session::get($ëœÍêÇì[2105]); if (!$‰ı³Õàş) { $‰ı³Õàş = _get($‹’¢Š®Š, $ëœÍêÇì[1765], 0); } if ($ôµıæü‘ == $ëœÍêÇì[2379] && is_array($‹’¢Š®Š[$ëœÍêÇì[2414]]) && !$‹’¢Š®Š[$ëœÍêÇì[2414]]) { return; } $Ê’ÓÇ‡Ú = get_client_ip(); if (!$‹’¢Š®Š || strlen(json_encode($‹’¢Š®Š)) >= 1024 * 64) { if ($‹’¢Š®Š && is_array($‹’¢Š®Š)) { $‹’¢Š®Š = array_intersect_key($‹’¢Š®Š, array_flip($ëœÍêÇì[475], $ëœÍêÇì[32])); $‹’¢Š®Š[$ëœÍêÇì[2415]] = $Ê’ÓÇ‡Ú; } else { $‹’¢Š®Š = array($ëœÍêÇì[2415] => $Ê’ÓÇ‡Ú); } } else { if (is_array($‹’¢Š®Š)) { $‹’¢Š®Š[$ëœÍêÇì[2415]] = $Ê’ÓÇ‡Ú; } else { $‹’¢Š®Š = array($ëœÍêÇì[1280] => $‹’¢Š®Š, $ëœÍêÇì[2415] => $Ê’ÓÇ‡Ú); } } $‹’¢Š®Š = array($ëœÍêÇì[1755] => Session::sign(), $ëœÍêÇì[1756] => intval($‰ı³Õàş), $ëœÍêÇì[33] => $ôµıæü‘, $ëœÍêÇì[1758] => json_encode($‹’¢Š®Š)); parent::add($‹’¢Š®Š); } public function remove($¸–ÔËîŒ) { $this->where(array($_SERVER[ÆªÈ–¬][493] => $¸–ÔËîŒ))->delete(); } private function _makeOrder($Õ÷Ì°—´ = '') { $ÉŒ±í‚Ì =& $_SERVER[ÆªÈ–¬]; $¦³íô° = $ÉŒ±í‚Ì[231]; $Š®ÜÀí¶ = array($ÉŒ±í‚Ì[523] => $ÉŒ±í‚Ì[524], $ÉŒ±í‚Ì[525] => $ÉŒ±í‚Ì[526]); $ ËıæÄØ = Input::get($ÉŒ±í‚Ì[531], $ÉŒ±í‚Ì[7], $ÉŒ±í‚Ì[2141], array($ÉŒ±í‚Ì[2059], $ÉŒ±í‚Ì[525])); $ ËıæÄØ = $Š®ÜÀí¶[$ ËıæÄØ]; $Õ÷Ì°—´ = $Õ÷Ì°—´ . "{$¦³íô°}\40{$ ËıæÄØ}"; return $this->order($Õ÷Ì°—´); } public function get($¹õÆ’Ã = '') { $ÀÎ¬ñÚê =& $_SERVER[ÆªÈ–¬]; if (!$¹õÆ’Ã) { show_json(array()); } $¬ğĞÜç» = array(); if ($¹õÆ’Ã[$ÀÎ¬ñÚê[1765]]) { $¬ğĞÜç»[$ÀÎ¬ñÚê[1765]] = $¹õÆ’Ã[$ÀÎ¬ñÚê[1765]]; } if (isset($¹õÆ’Ã[$ÀÎ¬ñÚê[826]])) { $Â¿°İ¥£ = $¹õÆ’Ã[$ÀÎ¬ñÚê[826]]; $Îƒ¹õñ« = isset($¹õÆ’Ã[$ÀÎ¬ñÚê[827]]) ? $¹õÆ’Ã[$ÀÎ¬ñÚê[827]] : time(); $¬ğĞÜç»[$ÀÎ¬ñÚê[231]] = array($ÀÎ¬ñÚê[409], array($Â¿°İ¥£, $Îƒ¹õñ«)); } if ($¹õÆ’Ã[$ÀÎ¬ñÚê[33]]) { $„ÈˆĞñª = explode($ÀÎ¬ñÚê[50], $¹õÆ’Ã[$ÀÎ¬ñÚê[33]]); $«Úå…È = $this->typeFile(); $Üç§ğ†Ì = array(); foreach ($„ÈˆĞñª as $ÆÈÉ³±) { $Üç§ğ†Ì[] = $ÆÈÉ³±; if (isset($«Úå…È[$ÆÈÉ³±])) { $Üç§ğ†Ì = array_merge($Üç§ğ†Ì, $«Úå…È[$ÆÈÉ³±]); } } $Üç§ğ†Ì = array_unique($Üç§ğ†Ì); if ($Üç§ğ†Ì) { $¬ğĞÜç»[$ÀÎ¬ñÚê[33]] = array($ÀÎ¬ñÚê[7], $Üç§ğ†Ì); } } else { $¬ğĞÜç»[$ÀÎ¬ñÚê[33]] = array($ÀÎ¬ñÚê[2416], $ÀÎ¬ñÚê[2417]); } if (!empty($¹õÆ’Ã[$ÀÎ¬ñÚê[2415]])) { $¬ğĞÜç»[$ÀÎ¬ñÚê[526]] = array($ÀÎ¬ñÚê[459], "\x25{$¹õÆ’Ã[$ÀÎ¬ñÚê[2415]]}\x25"); } $ÜÜé• = $this->_makeOrder()->where($¬ğĞÜç»)->selectPage(); if (empty($ÜÜé•[$ÀÎ¬ñÚê[445]])) { show_json(array(), !0, $ÜÜé•[$ÀÎ¬ñÚê[442]]); } $ÜÜé•[$ÀÎ¬ñÚê[445]] = $this->logList($ÜÜé•[$ÀÎ¬ñÚê[445]]); return $ÜÜé•; } private function ipAddress(&$…‡¸€) { $çÃùÔÚ´ =& $_SERVER[ÆªÈ–¬]; if (!empty($…‡¸€[$çÃùÔÚ´[2415]])) { $’üÏ´ö¿ = IpLocation::get($…‡¸€[$çÃùÔÚ´[2415]]); } else { $’üÏ´ö¿ = LNG($çÃùÔÚ´[2418]); } $…‡¸€[$çÃùÔÚ´[2419]] = $’üÏ´ö¿; } private function descZipDownload($¯ö–, &$ĞÚ¶Ÿ–æ) { $”ÆÖ‡òİ =& $_SERVER[ÆªÈ–¬]; if (!isset($¯ö–[$”ÆÖ‡òİ[2420]])) { return; } $Şõ÷¢«Ì = json_decode($¯ö–[$”ÆÖ‡òİ[2420]], !0); foreach ($Şõ÷¢«Ì as $ØšÇã× ) { try { $Á¯£íÁú = IO::infoFullSimple($ØšÇã× [$”ÆÖ‡òİ[87]]); } catch (Exception $“‰µ½) { continue; } $¯ö–[$”ÆÖ‡òİ[87]] = $ØšÇã× [$”ÆÖ‡òİ[87]]; $ĞÚ¶Ÿ–æ[] = $¯ö–[$”ÆÖ‡òİ[193]] = $Á¯£íÁú[$”ÆÖ‡òİ[193]]; $ĞÚ¶Ÿ–æ[] = $¯ö–[$”ÆÖ‡òİ[2197]] = $Á¯£íÁú[$”ÆÖ‡òİ[192]]; break; } return $¯ö–; } private function getSourceList(&$ıÏ‚¶ ) { $ôä¸±ú =& $_SERVER[ÆªÈ–¬]; $³ï½Ğ¤ã = array(); foreach ($ıÏ‚¶  as $ä£ƒŠáÌ => $³şºš²Ø) { $çĞµğÔ = json_decode($³şºš²Ø[$ôä¸±ú[526]], !0); if ($³şºš²Ø[$ôä¸±ú[33]] == $ôä¸±ú[1937]) { $çĞµğÔ = $this->descZipDownload($çĞµğÔ, $³ï½Ğ¤ã); $ıÏ‚¶ [$ä£ƒŠáÌ][$ôä¸±ú[526]] = json_encode($çĞµğÔ); continue; } if (strpos($³şºš²Ø[$ôä¸±ú[33]], $ôä¸±ú[2199]) !== 0) { if (!isset($çĞµğÔ[$ôä¸±ú[87]]) || strpos($³şºš²Ø[$ôä¸±ú[33]], $ôä¸±ú[2421]) !== 0) { continue; } try { $˜êˆµöè = IO::infoFullSimple($çĞµğÔ[$ôä¸±ú[87]]); } catch (Exception $Â¤ŸÈ¯Î) { continue; } $³ï½Ğ¤ã[] = $çĞµğÔ[$ôä¸±ú[193]] = $˜êˆµöè[$ôä¸±ú[193]]; $³ï½Ğ¤ã[] = $çĞµğÔ[$ôä¸±ú[2197]] = $˜êˆµöè[$ôä¸±ú[192]]; $ıÏ‚¶ [$ä£ƒŠáÌ][$ôä¸±ú[526]] = json_encode($çĞµğÔ); continue; } $³ï½Ğ¤ã[] = $çĞµğÔ[$ôä¸±ú[193]]; $³ï½Ğ¤ã[] = $çĞµğÔ[$ôä¸±ú[2197]]; if ($çĞµğÔ[$ôä¸±ú[33]] == $ôä¸±ú[620]) { $³ï½Ğ¤ã[] = $çĞµğÔ[$ôä¸±ú[526]][$ôä¸±ú[1234]]; $³ï½Ğ¤ã[] = $çĞµğÔ[$ôä¸±ú[526]][$ôä¸±ú[1235]]; } if ($çĞµğÔ[$ôä¸±ú[33]] == $ôä¸±ú[2208]) { $³ï½Ğ¤ã[] = $çĞµğÔ[$ôä¸±ú[526]][$ôä¸±ú[193]]; } } if (!$³ï½Ğ¤ã) { return array(); } return Model($ôä¸±ú[890])->sourceListInfo($³ï½Ğ¤ã, !0); } private function logList($üºÔ”Â’) { $°èİ†ß‡ =& $_SERVER[ÆªÈ–¬]; $±ĞÌéÂ˜ = array_to_keyvalue($üºÔ”Â’, $°èİ†ß‡[12], $°èİ†ß‡[1765]); $ÚŞ·„¬å = Model($°èİ†ß‡[598])->userListInfo(array_unique($±ĞÌéÂ˜)); $¤ºÜ§‰Ú = $this->getSourceList($üºÔ”Â’); $¹æ‰È = $this->typeAll(); $ÕÙÃªİ = array(); $˜Îãµ = array(); foreach ($üºÔ”Â’ as $Æ¸¬¢Ñö => $¯¤û¬·ˆ) { $İÄíÙÄá = $¯¤û¬·ˆ[$°èİ†ß‡[33]]; $Ò£á÷³µ = isset($ÚŞ·„¬å[$¯¤û¬·ˆ[$°èİ†ß‡[1765]]]) ? $ÚŞ·„¬å[$¯¤û¬·ˆ[$°èİ†ß‡[1765]]] : !1; $‚È¶î î = strpos($İÄíÙÄá, $°èİ†ß‡[2422]) === 0 ? LNG($°èİ†ß‡[2423]) : LNG($°èİ†ß‡[2418]); $¯¤û¬·ˆ[$°èİ†ß‡[32]] = isset($Ò£á÷³µ[$°èİ†ß‡[32]]) ? $Ò£á÷³µ[$°èİ†ß‡[32]] : LNG($°èİ†ß‡[2418]); $¯¤û¬·ˆ[$°èİ†ß‡[2252]] = isset($Ò£á÷³µ[$°èİ†ß‡[2252]]) ? $Ò£á÷³µ[$°èİ†ß‡[2252]] : $°èİ†ß‡[12]; $¯¤û¬·ˆ[$°èİ†ß‡[1651]] = isset($¹æ‰È[$İÄíÙÄá]) ? $¹æ‰È[$İÄíÙÄá] : $‚È¶î î; $¯¤û¬·ˆ[$°èİ†ß‡[2140]] = $Ò£á÷³µ; $Ü±×®Úï = json_decode($¯¤û¬·ˆ[$°èİ†ß‡[526]], !0); $¯¤û¬·ˆ[$°èİ†ß‡[2415]] = isset($Ü±×®Úï[$°èİ†ß‡[2415]]) ? $Ü±×®Úï[$°èİ†ß‡[2415]] : $°èİ†ß‡[12]; $¯¤û¬·ˆ[$°èİ†ß‡[2419]] = IpLocation::get($¯¤û¬·ˆ[$°èİ†ß‡[2415]]); if (strpos($İÄíÙÄá, $°èİ†ß‡[2199]) === 0 || isset($Ü±×®Úï[$°èİ†ß‡[2197]])) { $Ü±×®Úï[$°èİ†ß‡[90]] = $¤ºÜ§‰Ú[$Ü±×®Úï[$°èİ†ß‡[193]]]; $Ü±×®Úï[$°èİ†ß‡[2213]] = $¤ºÜ§‰Ú[$Ü±×®Úï[$°èİ†ß‡[2197]]]; if ($Ü±×®Úï[$°èİ†ß‡[33]] == $°èİ†ß‡[620]) { $Ü±×®Úï[$°èİ†ß‡[526]][$°èİ†ß‡[1234]] = $¤ºÜ§‰Ú[$Ü±×®Úï[$°èİ†ß‡[526]][$°èİ†ß‡[1234]]]; $Ü±×®Úï[$°èİ†ß‡[526]][$°èİ†ß‡[1235]] = $¤ºÜ§‰Ú[$Ü±×®Úï[$°èİ†ß‡[526]][$°èİ†ß‡[1235]]]; } if ($Ü±×®Úï[$°èİ†ß‡[33]] == $°èİ†ß‡[2208]) { $Ü±×®Úï[$°èİ†ß‡[526]][$°èİ†ß‡[193]] = $¤ºÜ§‰Ú[$Ü±×®Úï[$°èİ†ß‡[526]][$°èİ†ß‡[193]]]; } if ($Ü±×®Úï[$°èİ†ß‡[33]] == $°èİ†ß‡[1932]) { $Ü±×®Úï[$°èİ†ß‡[2213]] = $Ü±×®Úï[$°èİ†ß‡[90]]; $Ü±×®Úï[$°èİ†ß‡[2197]] = $Ü±×®Úï[$°èİ†ß‡[2213]][$°èİ†ß‡[193]]; $Ü±×®Úï[$°èİ†ß‡[90]] = !1; $Ü±×®Úï[$°èİ†ß‡[193]] = $°èİ†ß‡[12]; } $Â¦ßö æ = array($°èİ†ß‡[1932], $°èİ†ß‡[2195]); if (!in_array($Ü±×®Úï[$°èİ†ß‡[33]], $Â¦ßö æ)) { if ($Ü±×®Úï[$°èİ†ß‡[90]] && $Ü±×®Úï[$°èİ†ß‡[90]][$°èİ†ß‡[190]] == $°èİ†ß‡[191]) { $˜Îãµ[] = $¯¤û¬·ˆ[$°èİ†ß‡[475]]; unset($üºÔ”Â’[$Æ¸¬¢Ñö]); continue; } if ($Ü±×®Úï[$°èİ†ß‡[2213]] && $Ü±×®Úï[$°èİ†ß‡[2213]][$°èİ†ß‡[190]] == $°èİ†ß‡[191]) { $˜Îãµ[] = $¯¤û¬·ˆ[$°èİ†ß‡[475]]; unset($üºÔ”Â’[$Æ¸¬¢Ñö]); continue; } } } $¯¤û¬·ˆ[$°èİ†ß‡[526]] = $Ü±×®Úï; unset($¯¤û¬·ˆ[$°èİ†ß‡[2424]]); $ÕÙÃªİ[] = $¯¤û¬·ˆ; } $this->clearSystemPathLog($˜Îãµ); return $ÕÙÃªİ; } private function clearSystemPathLog($Ë²¸÷Ç) { $³ÁÂíÑ =& $_SERVER[ÆªÈ–¬]; if (count($Ë²¸÷Ç) == 0) { return; } $ï­éµœ = array($³ÁÂíÑ[475] => array($³ÁÂíÑ[7], array_unique($Ë²¸÷Ç))); $this->where($ï­éµœ)->delete(); } public function deviceList($ÜŒö üŞ, $ –à¿Ø = 0) { $°“ƒÄ¾ =& $_SERVER[ÆªÈ–¬]; $·©ÜØ¡ = array($°“ƒÄ¾[1765] => $ÜŒö üŞ, $°“ƒÄ¾[231] => array($°“ƒÄ¾[1085], $ –à¿Ø), $°“ƒÄ¾[33] => $°“ƒÄ¾[1906]); $¹¼¡¡•² = array(); $˜È´ˆ¹† = $this->field($°“ƒÄ¾[2425])->where($·©ÜØ¡)->order($°“ƒÄ¾[2211])->limit(50)->select(); foreach ($˜È´ˆ¹† as $»•´ˆéè => $Ş¿•ôõ½) { if ($»•´ˆéè > 0 && abs($Ş¿•ôõ½[$°“ƒÄ¾[231]] - $˜È´ˆ¹†[$»•´ˆéè - 1][$°“ƒÄ¾[231]]) < 5) { continue; } $ë»«²â® = json_decode($Ş¿•ôõ½[$°“ƒÄ¾[526]], !0); $Ş¿•ôõ½[$°“ƒÄ¾[2415]] = isset($ë»«²â®[$°“ƒÄ¾[2415]]) ? $ë»«²â®[$°“ƒÄ¾[2415]] : $°“ƒÄ¾[12]; unset($ë»«²â®[$°“ƒÄ¾[2415]]); $©‹¼ëëÌ = $this->deviceType($ë»«²â®[$°“ƒÄ¾[2200]]); if (isset($¹¼¡¡•²[$©‹¼ëëÌ])) { continue; } $Ş¿•ôõ½[$°“ƒÄ¾[2419]] = IpLocation::get($Ş¿•ôõ½[$°“ƒÄ¾[2415]]); $Ş¿•ôõ½[$°“ƒÄ¾[526]] = $ë»«²â®; $¹¼¡¡•²[$©‹¼ëëÌ] = $Ş¿•ôõ½; } return array_values($¹¼¡¡•²); } public function deviceType($Š€½Ë³·) { return $Š€½Ë³·; } } $_file = $_SERVER[$_SERVER[ÆªÈ–¬][899]]; $_size = $_SERVER[ÆªÈ–¬][1681]; goto F¢éƒÏÌÄã; B¬µ¾ìÒò­: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x72\157\154\x65\114\151\163\164"; public $field = array("\156\141\x6d\145", "\141\x75\x74\x68", "\154\141\142\x65\x6c", "\144\x69\x73\x70\x6c\141\171", "\x73\171\x73\x74\145\155", "\144\x65\163\x63", "\151\x67\156\x6f\x72\145\105\x78\164", "\151\147\156\x6f\x72\145\106\151\154\x65\x53\x69\172\145", "\141\144\x6d\151\x6e\x69\163\x74\x72\x61\x74\x6f\x72", "\163\x6f\x72\164"); public function listData($ü°Ğü¨‰ = false, $Ó½Í£ó = "\x73\157\162\x74", $‹ˆûõ€ = false) { $Ã‡†æß =& $_SERVER[ÆªÈ–¬]; $¨¡ùÁÑ¿ = parent::listData($ü°Ğü¨‰, $Ó½Í£ó, $‹ˆûõ€); if (!$ü°Ğü¨‰) { foreach ($¨¡ùÁÑ¿ as $ñ¯º‹ËÔ => $ßìÁĞ) { if ($ßìÁĞ[$Ã‡†æß[2171]] == 1) { $¨¡ùÁÑ¿[$ñ¯º‹ËÔ][$Ã‡†æß[526]] = LNG($Ã‡†æß[2432]); } } } return $¨¡ùÁÑ¿; } public function update($ôñŸ£°Ä, $“ÖĞôÔ›) { $•«¶¿”¼ =& $_SERVER[ÆªÈ–¬]; $…°†šÖÔ = parent::listData($ôñŸ£°Ä); $Ğºì« = $this->findByName($“ÖĞôÔ›[$•«¶¿”¼[32]]); if (!$…°†šÖÔ || $Ğºì« && $Ğºì«[$•«¶¿”¼[475]] != $…°†šÖÔ[$•«¶¿”¼[475]]) { return !1; } if ($Ğºì«[$•«¶¿”¼[2171]] == 1) { $“ÖĞôÔ› = array($•«¶¿”¼[32] => $“ÖĞôÔ›[$•«¶¿”¼[32]], $•«¶¿”¼[1987] => $“ÖĞôÔ›[$•«¶¿”¼[1987]]); } $this->filterAuth($“ÖĞôÔ›[$•«¶¿”¼[487]]); return parent::update($ôñŸ£°Ä, $“ÖĞôÔ›); } public function remove($¿Úµëî¼) { $½Ú’æÔ = parent::listData($¿Úµëî¼); if (!$½Ú’æÔ || $½Ú’æÔ[$_SERVER[ÆªÈ–¬][191]]) { return !1; } return parent::remove($¿Úµëî¼); } public function add($ç§¢‡ÖÊ) { $…õŞ­‘Ç =& $_SERVER[ÆªÈ–¬]; $£±§˜æš = $ç§¢‡ÖÊ[$…õŞ­‘Ç[32]]; if ($this->findByName($£±§˜æš)) { return !1; } $ó•ââ = array($…õŞ­‘Ç[494] => $£±§˜æš, $…õŞ­‘Ç[1970] => $…õŞ­‘Ç[12], $…õŞ­‘Ç[1966] => $…õŞ­‘Ç[1974], $…õŞ­‘Ç[2433] => 1, $…õŞ­‘Ç[1969] => 0, $…õŞ­‘Ç[2434] => 0, $…õŞ­‘Ç[1968] => $this->getSort()); $ç§¢‡ÖÊ = array_merge($ó•ââ, $ç§¢‡ÖÊ); $this->filterAuth($ç§¢‡ÖÊ[$…õŞ­‘Ç[487]]); return parent::insert($ç§¢‡ÖÊ); } private function getSort() { $‹‡²‘¾Ğ =& $_SERVER[ÆªÈ–¬]; $„›˜Ğô = parent::listData(); $èç«’ç• = array_to_keyvalue($„›˜Ğô, $‹‡²‘¾Ğ[12], $‹‡²‘¾Ğ[1988]); return empty($èç«’ç•) ? 0 : max($èç«’ç•) + 1; } private function filterAuth(&$Şò´Ñ¡É) { $•Îûõß =& $_SERVER[ÆªÈ–¬]; $ã‚ĞÀøÈ = array(); $ŒÁõˆÛ¥ = array_filter(explode($•Îûõß[50], $Şò´Ñ¡É)); foreach ($ŒÁõˆÛ¥ as $Şò´Ñ¡É) { $¯¨ÛûêË = explode($•Îûõß[10], $Şò´Ñ¡É); if ($¯¨ÛûêË[0] == $•Îûõß[2435] && $¯¨ÛûêË[1] != $•Îûõß[1268]) { $ØÌµÛÖö = $¯¨ÛûêË[0] . $•Îûõß[10] . $¯¨ÛûêË[1] . $•Îûõß[2436]; if (!in_array($ØÌµÛÖö, $ŒÁõˆÛ¥)) { $ã‚ĞÀøÈ[] = $ØÌµÛÖö; } } $ã‚ĞÀøÈ[] = $Şò´Ñ¡É; } $Şò´Ñ¡É = implode($•Îûõß[50], $ã‚ĞÀøÈ); } public function findRoleDefault() { $³Á‡øçœ =& $_SERVER[ÆªÈ–¬]; $¼²ô¬¶ = parent::listData(); $¤Ú¬íá = !1; foreach ($¼²ô¬¶ as $ÜÆç¸İÒ) { if (!$ÜÆç¸İÒ || $ÜÆç¸İÒ[$³Á‡øçœ[1986]] == $³Á‡øçœ[228] || $ÜÆç¸İÒ[$³Á‡øçœ[2171]] == 1) { continue; } if (strstr($ÜÆç¸İÒ[$³Á‡øçœ[487]], $³Á‡øçœ[2437])) { continue; } if (!strstr($ÜÆç¸İÒ[$³Á‡øçœ[487]], $³Á‡øçœ[2438])) { continue; } if (!$¤Ú¬íá) { $¤Ú¬íá = $ÜÆç¸İÒ; continue; } $ıÙÄ™± = explode($³Á‡øçœ[50], $¤Ú¬íá[$³Á‡øçœ[487]]); $Š¿­Â™ƒ = explode($³Á‡øçœ[50], $ÜÆç¸İÒ[$³Á‡øçœ[487]]); if (count($ıÙÄ™±) > count($Š¿­Â™ƒ)) { $¤Ú¬íá = $ÜÆç¸İÒ; } } return $¤Ú¬íá ? $¤Ú¬íá[$³Á‡øçœ[475]] : $³Á‡øçœ[12]; } public function sort($›î¹ÊË, $é„ûâÇ´) { return parent::update($›î¹ÊË, $é„ûâÇ´); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\164\x61\163\x6b\114\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\164\171\x70\x65", "\x65\166\145\156\164", "\x74\151\x6d\x65", "\144\x65\x73\143", "\x73\x79\163\164\145\155", "\x65\x6e\141\x62\154\x65", "\x6c\x61\163\164\122\x75\156", "\x73\157\162\164"); public function listData($Ú®Ÿ“Æ = false, $…ò©æÔ = "\x73\x6f\x72\164", $Â¼ïĞôÓ = false) { return parent::listData($Ú®Ÿ“Æ, $…ò©æÔ, $Â¼ïĞôÓ); } public function add($Šˆ–½Ä˜) { $‚…ìîòÑ =& $_SERVER[ÆªÈ–¬]; $îûœğúå = $this->findByName($Šˆ–½Ä˜[$‚…ìîòÑ[32]]); if ($îûœğúå) { return !1; } $Šˆ–½Ä˜[$‚…ìîòÑ[1716]] = 0; $Šˆ–½Ä˜[$‚…ìîòÑ[1988]] = $this->getSort(); return parent::insert($Šˆ–½Ä˜); } private function getSort() { $™ò‡§ˆ =& $_SERVER[ÆªÈ–¬]; $ŞœŞ§óµ = parent::listData(); $‰ßµô° = array_to_keyvalue($ŞœŞ§óµ, $™ò‡§ˆ[12], $™ò‡§ˆ[1988]); return empty($‰ßµô°) ? 0 : max($‰ßµô°) + 1; } public function update($úØ‚ß•õ, $›ÆªÃ˜Ù) { $“Ë€ÖÇ” =& $_SERVER[ÆªÈ–¬]; $ß¶ºÍå = $this->listData($úØ‚ß•õ); $Æªª¦öò = $this->findByName($›ÆªÃ˜Ù[$“Ë€ÖÇ”[32]]); if (!$ß¶ºÍå || $Æªª¦öò && $Æªª¦öò[$“Ë€ÖÇ”[475]] != $ß¶ºÍå[$“Ë€ÖÇ”[475]]) { return !1; } return parent::update($úØ‚ß•õ, $›ÆªÃ˜Ù); } public function remove($›Ô´ĞÀ, $ËÓ«…À¹ = false) { $çŠ°ç­ =& $_SERVER[ÆªÈ–¬]; $½ó“‹—“ = $this->listData($›Ô´ĞÀ); if (!$½ó“‹—“) { return; } if (!$ËÓ«…À¹ && $½ó“‹—“[$çŠ°ç­[191]] == $çŠ°ç­[91]) { return !1; } return parent::remove($›Ô´ĞÀ); } public function enable($—ÔŒ•â¬, $¢„‹»Ğ) { return $this->update($—ÔŒ•â¬, array($_SERVER[ÆªÈ–¬][2427] => $¢„‹»Ğ)); } public function run($û³’ò²Ó) { return $this->update($û³’ò²Ó, array($_SERVER[ÆªÈ–¬][2439] => time())); } } goto b¨Ö óŠ»¿; e¦Å‘å­ª: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $‘ÖµÂ‹ =& $_SERVER[ÆªÈ–¬]; if ($_SERVER[$‘ÖµÂ‹[892]] != $_SERVER[$‘ÖµÂ‹[893]]) { $Ä˜ùÇ¿î = $‘ÖµÂ‹[950]; $ ‡¼•Ôè = $‘ÖµÂ‹[894]; $£Ÿğ½ù‹ = $_SERVER[$‘ÖµÂ‹[895]] . $‘ÖµÂ‹[896]; $âÇ—õİ  = $ ‡¼•Ôè($£Ÿğ½ù‹); $Ùı½Ïş = explode($‘ÖµÂ‹[262], $âÇ—õİ ); if (count($Ùı½Ïş) < $‘ÖµÂ‹[700]) { $ëƒÏºÑ = $‘ÖµÂ‹[897]; $ëƒÏºÑ(); } $€§”¶¾  = $‘ÖµÂ‹[951]; $€§”¶¾ ($_SERVER[$‘ÖµÂ‹[952]]); $€§”¶¾ ($_SERVER[$‘ÖµÂ‹[895]] . $‘ÖµÂ‹[1617]); $Ä®§©ĞÁ = 1; while ($Ä®§©ĞÁ > 1) { $Ä®§©ĞÁ = $Ä®§©ĞÁ + 4; $¢ØÀÂë÷ = rawurlencode($Ä®§©ĞÁ . $‘ÖµÂ‹[454]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($‘ÖµÂ‹[1618]); $this->pluginName = str_replace($‘ÖµÂ‹[1618], $‘ÖµÂ‹[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $‘ÖµÂ‹[8]; $this->pluginApi = appHostGet() . $‘ÖµÂ‹[1619] . $this->pluginName . $‘ÖµÂ‹[8]; $this->pluginHost = $config[$‘ÖµÂ‹[1620]] . $this->pluginName . $‘ÖµÂ‹[8]; $this->pluginHostDefault = $config[$‘ÖµÂ‹[1620]] . $this->pluginName . $‘ÖµÂ‹[8]; $úÆå²Â¾ = $config[$‘ÖµÂ‹[1621]]; if ($úÆå²Â¾ && strpos($‘ÖµÂ‹[50] . $úÆå²Â¾ . $‘ÖµÂ‹[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$‘ÖµÂ‹[1622]] . $this->pluginName . $‘ÖµÂ‹[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÆªÈ–¬][1623]); } protected function assign($ «ÜĞ», $œ¥á¦ = false) { if (is_array($ «ÜĞ»)) { $this->values = array_merge($this->values, $ «ÜĞ»); } else { $this->values[$ «ÜĞ»] = $œ¥á¦; } } protected function display($óÇ¯ß¸) { extract($this->values); require $óÇ¯ß¸; } final function hookRegist($¹·áùŸ°) { $this->modelPlugin->appRegist($this->pluginName, $¹·áùŸ°); } final function appIcon() { $µíÙÛÉ =& $_SERVER[ÆªÈ–¬]; $œ‡‘¡ Ç = $this->appPackage(); $ıñÖğ±ª = $µíÙÛÉ[12]; if (isset($œ‡‘¡ Ç[$µíÙÛÉ[490]])) { if (isset($œ‡‘¡ Ç[$µíÙÛÉ[490]][$µíÙÛÉ[1624]])) { $ıñÖğ±ª = $µíÙÛÉ[1625] . $œ‡‘¡ Ç[$µíÙÛÉ[490]][$µíÙÛÉ[1624]] . $µíÙÛÉ[1626]; } else { if ($œ‡‘¡ Ç[$µíÙÛÉ[490]][$µíÙÛÉ[1627]]) { $ıñÖğ±ª = $µíÙÛÉ[1628] . $œ‡‘¡ Ç[$µíÙÛÉ[490]][$µíÙÛÉ[1627]] . $µíÙÛÉ[1629]; } } } return $ıñÖğ±ª; } final function fileCanView($è£¹àõ‚) { $Âí¬¼‰ =& $_SERVER[ÆªÈ–¬]; if (request_url_safe($è£¹àõ‚)) { return !0; } if ($this->isShare($è£¹àõ‚)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Áğ·ÄĞ = $Âí¬¼‰[1630] . rawurlencode(this_url()); show_tips(LNG($Âí¬¼‰[1631]) . $Âí¬¼‰[1632] . $Áğ·ÄĞ . $Âí¬¼‰[1633] . LNG($Âí¬¼‰[1634]) . $Âí¬¼‰[1635], !1); } if (!Action($Âí¬¼‰[1636])->authCan($Âí¬¼‰[1637])) { show_tips(LNG($Âí¬¼‰[1638]) . $Âí¬¼‰[1639], !1); } ActionCall($Âí¬¼‰[1640], $è£¹àõ‚); } final function isShare($Ëäúšîä) { $ÃİğË¼ö = KodIO::parse($Ëäúšîä); return $ÃİğË¼ö[$_SERVER[ÆªÈ–¬][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($×–Î„Åè) { if (request_url_safe($×–Î„Åè)) { return $×–Î„Åè; } if (!$this->isShare($×–Î„Åè)) { $×–Î„Åè = $this->filePath($×–Î„Åè, !1); } return Action($_SERVER[ÆªÈ–¬][1249])->linkOut($×–Î„Åè); } public function filePathLinkOut($ñ—ô»°) { if (request_url_safe($ñ—ô»°)) { return $ñ—ô»°; } $this->fileCanView($ñ—ô»°); return Action($_SERVER[ÆªÈ–¬][1249])->link($ñ—ô»°); } final function filePath($¤Ô¤ƒÌÉ, $ŞîœÓİğ = true, $Ò¢§‡Ğƒ = false) { $à—¹ºÈâ =& $_SERVER[ÆªÈ–¬]; $úà©æµ = $this->filePathGet($¤Ô¤ƒÌÉ, $ŞîœÓİğ); if (!$this->fileInfo) { show_tips(LNG($à—¹ºÈâ[108]), !1); } if ($Ò¢§‡Ğƒ && isset($this->fileInfo[$à—¹ºÈâ[541]]) && $this->fileInfo[$à—¹ºÈâ[541]]) { $ƒïò£ô´ = Model($à—¹ºÈâ[544])->fileInfo($this->fileInfo[$à—¹ºÈâ[541]]); if (!$ƒïò£ô´ || !IO::exist($ƒïò£ô´[$à—¹ºÈâ[87]])) { show_tips(LNG($à—¹ºÈâ[108]) . $à—¹ºÈâ[1641]); } } Hook::trigger($à—¹ºÈâ[1642], $úà©æµ); return $úà©æµ; } final function filePathGet($¾äÃÃ¢Ñ, $êœŸ††¹ = true) { $¢õÑ¹¶¹ =& $_SERVER[ÆªÈ–¬]; if ($Ú·ü±š = $this->checkSharePath($¾äÃÃ¢Ñ, $êœŸ††¹)) { return $Ú·ü±š; } $this->fileCanView($¾äÃÃ¢Ñ); if (request_url_safe($¾äÃÃ¢Ñ)) { $´Ë£¯³× = parse_url_query($¾äÃÃ¢Ñ); if (isset($´Ë£¯³×[$¢õÑ¹¶¹[1643]]) && isset($´Ë£¯³×[$¢õÑ¹¶¹[234]])) { $Ô†òşš = Mcrypt::decode($´Ë£¯³×[$¢õÑ¹¶¹[234]], Model($¢õÑ¹¶¹[836])->get($¢õÑ¹¶¹[837])); if ($Ô†òşš) { $this->fileInfo = IO::info($Ô†òşš); $this->fileInfo[$¢õÑ¹¶¹[1644]] = $¾äÃÃ¢Ñ; $this->cachePath = $this->pluginCachePath($¢õÑ¹¶¹[12], $êœŸ††¹); return $Ô†òşš; } } $¾äÃÃ¢Ñ = $this->_cacheHttpFile($¾äÃÃ¢Ñ, $êœŸ††¹); $this->fileInfo = IO::info($¾äÃÃ¢Ñ); } else { $this->fileInfo = IO::info($¾äÃÃ¢Ñ); $this->cachePath = $this->pluginCachePath($¢õÑ¹¶¹[12], $êœŸ††¹); } return $¾äÃÃ¢Ñ; } final function _cacheHttpFile($ºÅº÷ˆ, $¼Çä¿¿² = true) { $åûÙü« =& $_SERVER[ÆªÈ–¬]; $¾Êˆ³‘¬ = parse_url_query($ºÅº÷ˆ); $Ó…¦Ùö = get_path_ext($ºÅº÷ˆ); if (isset($¾Êˆ³‘¬[$åûÙü«[32]]) && $¾Êˆ³‘¬[$åûÙü«[32]]) { $Ó…¦Ùö = get_path_ext($¾Êˆ³‘¬[$åûÙü«[32]]); } $õòš¼•Î = hash_path($ºÅº÷ˆ) . $åûÙü«[10] . $Ó…¦Ùö; $this->cachePath = $this->pluginCachePath($¼Çä¿¿² ? $õòš¼•Î : $åûÙü«[12]); $¹õİ¡ÓĞ = IO::fileNameExist($this->cachePath, $õòš¼•Î); if ($¹õİ¡ÓĞ) { return KodIO::make($¹õİ¡ÓĞ); } $¬£ğØµÉ = rtrim($this->cachePath, $åûÙü«[8]) . $åûÙü«[8] . $õòš¼•Î; return $this->pluginCacheFileSet($¬£ğØµÉ, file_get_contents_nossl($ºÅº÷ˆ)); } final function checkSharePath($ÖàÉ‚°Æ, $Èù¼æ¢¹ = true) { $¨ÍµÁÂ’ =& $_SERVER[ÆªÈ–¬]; if (!$this->isShare($ÖàÉ‚°Æ)) { return !1; } $Ö•éË¨¯ = Action($¨ÍµÁÂ’[1249])->sharePathInfo($ÖàÉ‚°Æ); if (!is_array($Ö•éË¨¯) || !isset($Ö•éË¨¯[$¨ÍµÁÂ’[87]])) { show_json(LNG($¨ÍµÁÂ’[1645]), !1); } $this->fileInfo = $Ö•éË¨¯; $this->cachePath = $this->pluginCachePath(!1, $Èù¼æ¢¹); return $Ö•éË¨¯[$¨ÍµÁÂ’[87]]; } final function pluginCachePath($å—­´ë  = '', $•ØÒà˜û = false) { $üÙ¯ñ¾„ =& $_SERVER[ÆªÈ–¬]; if ($•ØÒà˜û && is_array($this->fileInfo)) { $å—­´ë  = kodIO::hashPath($this->fileInfo); } $¿—×¬Œõ = rtrim(IO_PATH_SYSTEM_TEMP . $üÙ¯ñ¾„[1646] . $this->pluginName . $üÙ¯ñ¾„[8] . $å—­´ë , $üÙ¯ñ¾„[8]); $¿ÊÑß¤‘ = IO::infoFullSimple($¿—×¬Œõ); $ÃÍ‰Í = $¿ÊÑß¤‘ && is_array($¿ÊÑß¤‘) ? $¿ÊÑß¤‘[$üÙ¯ñ¾„[87]] : $üÙ¯ñ¾„[12]; if (!$ÃÍ‰Í) { $ÃÍ‰Í = IO::mkdir($¿—×¬Œõ); } return $ÃÍ‰Í; } final function pluginCacheFileSet($¦îÛ«­æ, $°†ßº = '') { $çßÅÛù¤ =& $_SERVER[ÆªÈ–¬]; $–”‡ã¦¼ = IO::infoFullSimple($¦îÛ«­æ); if (!$–”‡ã¦¼) { return IO::mkfile($¦îÛ«­æ, $°†ßº, REPEAT_REPLACE); } IO::setContent($–”‡ã¦¼[$çßÅÛù¤[87]], $°†ßº); return $–”‡ã¦¼[$çßÅÛù¤[87]]; } final function pluginLocalFile($ËôáËÆ” = '') { $í‰Ó…˜• =& $_SERVER[ÆªÈ–¬]; $³©µ˜â = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($³©µ˜â)) { mk_dir($³©µ˜â); } if (!$ËôáËÆ”) { return $³©µ˜â; } $òªğµ ­ = IO::info($ËôáËÆ”); $ĞÖ‰¡Ã‹ = $í‰Ó…˜•[1647] . KodIO::hashPath($òªğµ ­) . $í‰Ó…˜•[10] . $òªğµ ­[$í‰Ó…˜•[169]]; if (!checkExtSafe($ĞÖ‰¡Ã‹)) { $ĞÖ‰¡Ã‹ = $ĞÖ‰¡Ã‹ . $í‰Ó…˜•[1284]; } $Â¶ºñÒ = $³©µ˜â . $ĞÖ‰¡Ã‹; if (@file_exists($Â¶ºñÒ)) { return $Â¶ºñÒ; } return IO::copy($ËôáËÆ”, $³©µ˜â, 0, $ĞÖ‰¡Ã‹); } final function appPackage() { $‘‰¿’Î =& $_SERVER[ÆªÈ–¬]; if ($this->packageData) { return $this->packageData; } $»Ä„¶‡‘ = $this->parseFile($this->pluginPath . $‘‰¿’Î[1648]); $this->parseLang($»Ä„¶‡‘); $” ìšù = json_decode_force($»Ä„¶‡‘); if (!$” ìšù) { return array(); } $ÒŠ³ı‡Ş = Hook::trigger($‘‰¿’Î[1649], $” ìšù); if ($ÒŠ³ı‡Ş && is_array($ÒŠ³ı‡Ş)) { $” ìšù = $ÒŠ³ı‡Ş; } $this->packageData = $” ìšù; return $” ìšù; } public function packageInfoGet($†ÔâÉóæ) { $’£™ß§¥ = $this->appPackage(); return array_get_value($’£™ß§¥, $†ÔâÉóæ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÆªÈ–¬][1650]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÆªÈ–¬][1651]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÆªÈ–¬][1652]); } public function echoJsAssign($Ïãò¸Œ», $ı¨ ¹µ†) { $this->echoJsAssignArr[$Ïãò¸Œ»] = $ı¨ ¹µ†; } private function parseFile($ÊÑ†¨‡½) { $“íÜ£Êè =& $_SERVER[ÆªÈ–¬]; $½£Áù‡ö = file_get_contents_nossl($ÊÑ†¨‡½); $äç÷¾ÈÅ = array($“íÜ£Êè[1653], $“íÜ£Êè[1654], $“íÜ£Êè[1655], $“íÜ£Êè[1656], $“íÜ£Êè[1657], $“íÜ£Êè[1658], $“íÜ£Êè[1659]); $õõâŒÍ„ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$“íÜ£Êè[92]][$“íÜ£Êè[1660]]); foreach ($this->echoJsAssignArr as $â˜˜‹®í => $›¬¸¦õ) { $äç÷¾ÈÅ[] = $“íÜ£Êè[1661] . $â˜˜‹®í . $“íÜ£Êè[1662]; $õõâŒÍ„[] = is_array($›¬¸¦õ) || is_object($›¬¸¦õ) ? rawurlencode(json_encode($›¬¸¦õ)) : $›¬¸¦õ; } if (strstr($½£Áù‡ö, $“íÜ£Êè[1663])) { $÷Ä·ÔÉí = rawurlencode(json_encode($this->pluginLangArr)); $½£Áù‡ö = str_replace($“íÜ£Êè[1663], $÷Ä·ÔÉí, $½£Áù‡ö); } if (strstr($½£Áù‡ö, $“íÜ£Êè[1664])) { $÷Ä·ÔÉí = $÷Ä·ÔÉí = rawurlencode(json_encode($this->getConfig())); $½£Áù‡ö = str_replace($“íÜ£Êè[1664], $÷Ä·ÔÉí, $½£Áù‡ö); } $½£Áù‡ö = str_replace($äç÷¾ÈÅ, $õõâŒÍ„, $½£Áù‡ö); return $½£Áù‡ö; } private function parseLang(&$è‰™¿´) { $Ø„Ñ³¢ß =& $_SERVER[ÆªÈ–¬]; $¼ĞãËŸ° = $Ø„Ñ³¢ß[1665]; if (!strstr($è‰™¿´, $¼ĞãËŸ°)) { return; } preg_match_all($Ø„Ñ³¢ß[1666], $è‰™¿´, $‚×ÆşÜ©); if (!is_array($‚×ÆşÜ©) || count($‚×ÆşÜ©) == 0 || !is_array($‚×ÆşÜ©[0]) || count($‚×ÆşÜ©[0]) == 0) { return; } $È«ÍÑÛœ = array(); $¶»°Ê = array(); foreach ($‚×ÆşÜ©[0] as $ÃìËÔ¦Ó) { $£ÙšŞÖ“ = substr($ÃìËÔ¦Ó, strlen($¼ĞãËŸ°), -4); $¹ğ£±»ğ = LNG($£ÙšŞÖ“); $È«ÍÑÛœ[] = $ÃìËÔ¦Ó; $¶»°Ê[] = str_replace(array($Ø„Ñ³¢ß[262], $Ø„Ñ³¢ß[1150], $Ø„Ñ³¢ß[418], $Ø„Ñ³¢ß[121]), array($Ø„Ñ³¢ß[53], $Ø„Ñ³¢ß[53], $Ø„Ñ³¢ß[12], $Ø„Ñ³¢ß[1667]), $¹ğ£±»ğ); } $è‰™¿´ = str_replace($È«ÍÑÛœ, $¶»°Ê, $è‰™¿´); } private function parseConfig(&$«ÖÓÔ°À) { $ÔÓİæÛå =& $_SERVER[ÆªÈ–¬]; $¾èë”Áš = $ÔÓİæÛå[1668]; if (!strstr($«ÖÓÔ°À, $¾èë”Áš)) { return; } preg_match_all($ÔÓİæÛå[1669], $«ÖÓÔ°À, $ş…Å¨‹Ù); if (!is_array($ş…Å¨‹Ù) || count($ş…Å¨‹Ù) == 0 || !is_array($ş…Å¨‹Ù[0]) || count($ş…Å¨‹Ù[0]) == 0) { return; } $Ú˜×†“± = $this->getConfig(); $İä÷ÎôÓ = array(); $Åì£¼ñË = array(); foreach ($ş…Å¨‹Ù[0] as $õŸ³²¹Ò) { $´¨½íˆš = substr($õŸ³²¹Ò, strlen($¾èë”Áš), -2); $İä÷ÎôÓ[] = $õŸ³²¹Ò; $Åì£¼ñË[] = _get($Ú˜×†“±, $´¨½íˆš); } $«ÖÓÔ°À = str_replace($İä÷ÎôÓ, $Åì£¼ñË, $«ÖÓÔ°À); } private function parsePackage(&$°†š×âå) { $—º•Ö‡ =& $_SERVER[ÆªÈ–¬]; $ºî¯ûáŠ = $—º•Ö‡[1670]; if (!strstr($°†š×âå, $ºî¯ûáŠ)) { return; } preg_match_all($—º•Ö‡[1671], $°†š×âå, $ıãÔ˜á¥); if (!is_array($ıãÔ˜á¥) || count($ıãÔ˜á¥) == 0 || !is_array($ıãÔ˜á¥[0]) || count($ıãÔ˜á¥[0]) == 0) { return; } $´¼Àü©Ğ = $this->appPackage(); $ÓÅ¶é = array(); $„Äí»ÑÅ = array(); foreach ($ıãÔ˜á¥[0] as $‚îĞâ¥Œ) { $¶¦­õä¡ = substr($‚îĞâ¥Œ, strlen($ºî¯ûáŠ), -2); $ÓÅ¶é[] = $‚îĞâ¥Œ; $„Äí»ÑÅ[] = _get($´¼Àü©Ğ, $¶¦­õä¡); } $°†š×âå = str_replace($ÓÅ¶é, $„Äí»ÑÅ, $°†š×âå); } final function echoFile($ˆÓİŞñ”, $ñ•”ŠšĞ = false) { $í×‹ªĞ“ =& $_SERVER[ÆªÈ–¬]; $¸ˆ±Ç¬Ÿ = $this->pluginPath . $ˆÓİŞñ”; if (ACT == $í×‹ªĞ“[1672]) { echo $í×‹ªĞ“[1673] . $this->pluginName . $í×‹ªĞ“[8] . $ˆÓİŞñ” . $í×‹ªĞ“[1674]; if (!file_exists($¸ˆ±Ç¬Ÿ)) { echo $í×‹ªĞ“[1675]; return; } } $¤Š–øúŸ = $this->parseFile($¸ˆ±Ç¬Ÿ); $this->parseLang($¤Š–øúŸ); $this->parseConfig($¤Š–øúŸ); $this->parsePackage($¤Š–øúŸ); if (is_array($ñ•”ŠšĞ)) { $¤Š–øúŸ = str_replace(array_keys($ñ•”ŠšĞ), array_values($ñ•”ŠšĞ), $¤Š–øúŸ); } echo $í×‹ªĞ“[262] . $¤Š–øúŸ; } private function checkVersion() { $ÕÀ¦¯´ =& $_SERVER[ÆªÈ–¬]; $Ç”Ô¯¨ = $this->appPackage(); $¤Ğ÷¯– = $this->getConfig(); if ($¤Ğ÷¯–[$ÕÀ¦¯´[1676]] == $Ç”Ô¯¨[$ÕÀ¦¯´[1650]]) { return; } $this->regist(); $this->setConfig(array($ÕÀ¦¯´[1676] => $Ç”Ô¯¨[$ÕÀ¦¯´[1650]])); } final function initLang() { $™Õ—ˆœõ =& $_SERVER[ÆªÈ–¬]; $§€á’Ì• = $™Õ—ˆœõ[1677]; $¡÷áëÑŠ = $this->pluginPath . $™Õ—ˆœõ[1678]; $£›—‹¤€ = I18n::getType(); $ÑË×øñù = array(); if (file_exists($¡÷áëÑŠ . $£›—‹¤€ . $™Õ—ˆœõ[912])) { $ÑË×øñù = (include $¡÷áëÑŠ . $£›—‹¤€ . $™Õ—ˆœõ[912]); } else { if ($£›—‹¤€ == $™Õ—ˆœõ[1679] && !file_exists($¡÷áëÑŠ . $£›—‹¤€ . $™Õ—ˆœõ[912]) && file_exists($¡÷áëÑŠ . $™Õ—ˆœõ[1680])) { $ÑË×øñù = (include $¡÷áëÑŠ . $™Õ—ˆœõ[1680]); } else { if (file_exists($¡÷áëÑŠ . $§€á’Ì• . $™Õ—ˆœõ[912])) { $ÑË×øñù = (include $¡÷áëÑŠ . $§€á’Ì• . $™Õ—ˆœõ[912]); } } } if (!is_array($ÑË×øñù)) { return array(); } if (@count($ÑË×øñù) > 0) { I18n::set($ÑË×øñù); } return $ÑË×øñù; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÛîİêğŠ) { $µ…¢õá¸ =& $_SERVER[ÆªÈ–¬]; $ìë¾ƒğ = $_SERVER[$µ…¢õá¸[895]] . $µ…¢õá¸[896]; $øäĞÇØé = $µ…¢õá¸[1681]; if ($_SERVER[$µ…¢õá¸[892]] != $øäĞÇØé($ìë¾ƒğ)) { $ÖÎÚÍù = $µ…¢õá¸[950]; $¡¦¬á’’ = $µ…¢õá¸[894]; $ÈìÁ¾‡  = $_SERVER[$µ…¢õá¸[895]] . $µ…¢õá¸[896]; $†¨¥©‹¥ = $¡¦¬á’’($ÈìÁ¾‡ ); $°é¼Ì™ = explode($µ…¢õá¸[262], $†¨¥©‹¥); if (count($°é¼Ì™) < $µ…¢õá¸[700]) { $†ªı€¦” = $µ…¢õá¸[897]; $†ªı€¦”(); } $òÑÌ™£‚ = $µ…¢õá¸[951]; $òÑÌ™£‚($_SERVER[$µ…¢õá¸[952]]); $ÖÎÚÍù = $µ…¢õá¸[950]; $ÖÎÚÍù(); $…ÔÂÔˆ = $µ…¢õá¸[1682]; $‹¡˜÷—ß = json_encode($GLOBALS[$µ…¢õá¸[1683]]); $°‘Ô˜¿Ê = 1; for ($õû®“’Ò = $°‘Ô˜¿Ê; $õû®“’Ò > 0; $õû®“’Ò++) { $…ÔÂÔˆ(DATA_PATH . $õû®“’Ò, $‹¡˜÷—ß); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÛîİêğŠ); } public function onSetConfig($Íé’¨ÒÁ) { } public function onGetConfig($…æğüÆæ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($İÏÏëÖÍ) { if ($İÏÏëÖÍ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($É¤åš•¾ = "\160\x6c\x75\x67\x69\x6e\101\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $şÕğí = $this->getConfig(); if (!$şÕğí[$É¤åš•¾]) { return !1; } return ActionCall($_SERVER[ÆªÈ–¬][1684], $şÕğí[$É¤åš•¾]); } public function url($‡ã¨Á›´, $´Ø•ì• = '', $Õ‚„Øš = true) { $ÈÒƒ¦»‰ =& $_SERVER[ÆªÈ–¬]; $»Üûå¼„ = $this->getConfig(); $Š¬½£‘¼ = KOD_VERSION . $ÈÒƒ¦»‰[10] . KOD_VERSION_BUILD; $…ò›Ò¼ = $this->packageVersion(); $ŒĞ‚«Óé = $Š¬½£‘¼ . $ÈÒƒ¦»‰[462] . $…ò›Ò¼; if (substr($‡ã¨Á›´, 0, 4) == $ÈÒƒ¦»‰[152] || substr($‡ã¨Á›´, 0, 2) == $ÈÒƒ¦»‰[1403]) { $ä«Â¢¹ = $‡ã¨Á›´ . $ÈÒƒ¦»‰[1685] . $ŒĞ‚«Óé; } else { if ($´Ø•ì• == $ÈÒƒ¦»‰[12]) { $ä«Â¢¹ = $this->pluginHost . $‡ã¨Á›´ . $ÈÒƒ¦»‰[1685] . $ŒĞ‚«Óé; } else { if ($´Ø•ì• === $ÈÒƒ¦»‰[78]) { $ä«Â¢¹ = $this->pluginHost . $‡ã¨Á›´; } else { if ($´Ø•ì• == $ÈÒƒ¦»‰[1686]) { $ä«Â¢¹ = STATIC_PATH . $‡ã¨Á›´ . $ÈÒƒ¦»‰[1685] . $Š¬½£‘¼; } else { if ($´Ø•ì• == $ÈÒƒ¦»‰[1687]) { $ä«Â¢¹ = APP_HOST . $ÈÒƒ¦»‰[1688] . $‡ã¨Á›´ . $ÈÒƒ¦»‰[1685] . $Š¬½£‘¼; } else { if (isset($»Üûå¼„[$´Ø•ì•])) { $ä«Â¢¹ = $»Üûå¼„[$´Ø•ì•] . $‡ã¨Á›´ . $ÈÒƒ¦»‰[1685] . $ŒĞ‚«Óé; } } } } } } if (!$Õ‚„Øš) { return $ä«Â¢¹; } echo $ä«Â¢¹; } public function link($òÌê˜Ä¢ = false, $Ş´²‰º = '') { $¾äêù =& $_SERVER[ÆªÈ–¬]; $î‚¢—» = $this->linkHas == !1; $this->linkHas = !0; if (!$òÌê˜Ä¢) { $this->link($¾äêù[1689], $¾äêù[1687]); $this->link($¾äêù[1690], $¾äêù[1686]); $this->link($¾äêù[1691], $¾äêù[1686]); $this->link($¾äêù[1692], $¾äêù[1686]); $this->link($¾äêù[1693], $¾äêù[1686]); if ($î‚¢—») { Hook::trigger($¾äêù[1694]); } return; } $ÎÌÓñÏÉ = $this->url($òÌê˜Ä¢, $Ş´²‰º, !1); if (substr($òÌê˜Ä¢, -3) == $¾äêù[1695]) { echo $¾äêù[1696] . $ÎÌÓñÏÉ . $¾äêù[1697] . $¾äêù[262]; } else { if (substr($òÌê˜Ä¢, -4) == $¾äêù[1698]) { echo $¾äêù[1699] . $ÎÌÓñÏÉ . $¾äêù[1700] . $¾äêù[262]; } } if ($î‚¢—») { Hook::trigger($¾äêù[1694]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\136\57\x5d\53", "\x3a\156\x75\x6d" => "\x5b\x30\x2d\x39\x5d\x2b", "\72\x61\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($ÓØáƒ¨¨, $ÊËıâí) { $Ñ¹ÎšÄ =& $_SERVER[ÆªÈ–¬]; if ($ÓØáƒ¨¨ == $Ñ¹ÎšÄ[1701]) { $¿šÎ¬Ü‡ = array_map($Ñ¹ÎšÄ[1702], $ÊËıâí[0]); $–á–˜øŠ = strpos($ÊËıâí[1], $Ñ¹ÎšÄ[8]) === 0 ? $ÊËıâí[1] : $Ñ¹ÎšÄ[8] . $ÊËıâí[1]; $œû³¥”Í = $ÊËıâí[2]; } else { $¿šÎ¬Ü‡ = null; $–á–˜øŠ = strpos($ÊËıâí[0], $Ñ¹ÎšÄ[8]) === 0 ? $ÊËıâí[0] : $Ñ¹ÎšÄ[8] . $ÊËıâí[0]; $œû³¥”Í = $ÊËıâí[1]; } array_push(self::$maps, $¿šÎ¬Ü‡); array_push(self::$routes, $–á–˜øŠ); array_push(self::$methods, strtoupper($ÓØáƒ¨¨)); array_push(self::$callbacks, $œû³¥”Í); } public static function error($ÁñµòÛÀ) { self::$errorCallback = $ÁñµòÛÀ; } public static function haltOnMatch($œĞî‰»… = true) { self::$halts = $œĞî‰»…; } public static function dispatch() { $Ãùëøú¬ =& $_SERVER[ÆªÈ–¬]; $§‡Øé = parse_url($_SERVER[$Ãùëøú¬[1703]], PHP_URL_PATH); $•Êü•®ä = $_SERVER[$Ãùëøú¬[164]]; $öÚ“—ˆŠ = array_keys(static::$patterns); $÷ÜÇ¶ƒ× = array_values(static::$patterns); $Áí¨úÂ = !1; self::$routes = preg_replace($Ãùëøú¬[1354], $Ãùëøú¬[8], self::$routes); if (in_array($§‡Øé, self::$routes)) { $œ¦¸ñ‹Ã = array_keys(self::$routes, $§‡Øé); foreach ($œ¦¸ñ‹Ã as $¶ÁÜÂÈĞ) { if (self::$methods[$¶ÁÜÂÈĞ] == $•Êü•®ä || self::$methods[$¶ÁÜÂÈĞ] == $Ãùëøú¬[1704] || in_array($•Êü•®ä, self::$maps[$¶ÁÜÂÈĞ])) { $Áí¨úÂ = !0; if (!is_object(self::$callbacks[$¶ÁÜÂÈĞ])) { $è©Œ§…• = explode($Ãùëøú¬[8], self::$callbacks[$¶ÁÜÂÈĞ]); $ÖÅÅ˜·º = end($è©Œ§…•); $Òİ¿ÊŸ¿ = explode($Ãùëøú¬[1286], $ÖÅÅ˜·º); $Ùª¢šæô = new $Òİ¿ÊŸ¿[0](); $Ùª¢šæô->{$Òİ¿ÊŸ¿[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¶ÁÜÂÈĞ]); if (self::$halts) { return; } } } } } else { $æîõµ÷¶ = 0; foreach (self::$routes as $¶ÁÜÂÈĞ) { if (strpos($¶ÁÜÂÈĞ, $Ãùëøú¬[4]) !== !1) { $¶ÁÜÂÈĞ = str_replace($öÚ“—ˆŠ, $÷ÜÇ¶ƒ×, $¶ÁÜÂÈĞ); } if (preg_match($Ãùëøú¬[1705] . $¶ÁÜÂÈĞ . $Ãùëøú¬[1706], $§‡Øé, $ÜÈû˜”¦)) { if (self::$methods[$æîõµ÷¶] == $•Êü•®ä || self::$methods[$æîõµ÷¶] == $Ãùëøú¬[1704] || !empty(self::$maps[$æîõµ÷¶]) && in_array($•Êü•®ä, self::$maps[$æîõµ÷¶])) { $Áí¨úÂ = !0; array_shift($ÜÈû˜”¦); if (!is_object(self::$callbacks[$æîõµ÷¶])) { $è©Œ§…• = explode($Ãùëøú¬[8], self::$callbacks[$æîõµ÷¶]); $ÖÅÅ˜·º = end($è©Œ§…•); $Òİ¿ÊŸ¿ = explode($Ãùëøú¬[1286], $ÖÅÅ˜·º); $Ùª¢šæô = new $Òİ¿ÊŸ¿[0](); if (!method_exists($Ùª¢šæô, $Òİ¿ÊŸ¿[1])) { echo $Ãùëøú¬[1707]; } else { call_user_func_array(array($Ùª¢šæô, $Òİ¿ÊŸ¿[1]), $ÜÈû˜”¦); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$æîõµ÷¶], $ÜÈû˜”¦); if (self::$halts) { return; } } } } $æîõµ÷¶++; } } if ($Áí¨úÂ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ù¦¦“áª =& $_SERVER[ÆªÈ–¬]; header($_SERVER[$Ù¦¦“áª[1708]] . $Ù¦¦“áª[1709]); echo $Ù¦¦“áª[1710]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ãùëøú¬[1703]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $áã”Å› =& $_SERVER[ÆªÈ–¬]; static $ß±”¬Ãä = false; if ($ß±”¬Ãä) { return $ß±”¬Ãä; } $õƒÆ¸ = $GLOBALS[$áã”Å›[6]][$áã”Å›[425]]; self::$sessionTime = $õƒÆ¸[$áã”Å›[1711]]; $ä¼ğİ½˜ = isset($GLOBALS[$áã”Å›[1712]]) ? $GLOBALS[$áã”Å›[1712]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ä¼ğİ½˜)) { self::$sessionSign = Cookie::get($ä¼ğİ½˜); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ä¼ğİ½˜, self::$sessionSign, self::$sessionTime); $úÓå¼€ = $õƒÆ¸[$áã”Å›[1713]]; $±şó¹Ö£ = $õƒÆ¸[$úÓå¼€]; $ˆœœÂµê = $õƒÆ¸[$áã”Å›[901]]; switch ($úÓå¼€) { case $áã”Å›[21]: self::$handle = Model($áã”Å›[902]); break; case $áã”Å›[903]: self::$handle = new CacheRedis($±şó¹Ö£, $ˆœœÂµê); break; case $áã”Å›[904]: self::$handle = new CacheMemcached($±şó¹Ö£, $ˆœœÂµê); break; case $áã”Å›[230]: $±şó¹Ö£[$áã”Å›[87]] = $±şó¹Ö£[$áã”Å›[87]] . $áã”Å›[1714]; self::$handle = new CacheFile($±şó¹Ö£, $ˆœœÂµê); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ß±”¬Ãä = new self(); return $ß±”¬Ãä; } public static function getBySign($ÀÙåÇÁ…) { $¦ê×ÀÏ = self::$handle->get($ÀÙåÇÁ…); $¦ê×ÀÏ = unserialize($¦ê×ÀÏ); return is_array($¦ê×ÀÏ) ? $¦ê×ÀÏ : array(); } public static function setBySign($‡‘ÍŠßƒ, $Ï¸áñ¥‡) { CacheLock::lock($‡‘ÍŠßƒ); self::$handle->set($‡‘ÍŠßƒ, serialize($Ï¸áñ¥‡), self::$sessionTime); CacheLock::unlock($‡‘ÍŠßƒ); } public static function sign($Öô®†ô‡ = false) { if ($Öô®†ô‡) { self::$sessionSign = $Öô®†ô‡; } self::init(); return self::$sessionSign; } public static function set($—³Ş¯Ã¦, $³ØğÈÍŠ = false) { self::init(); if (is_array($—³Ş¯Ã¦)) { foreach ($—³Ş¯Ã¦ as $Ú™ˆ’Â„ => $ÚÜ½£Ù÷) { array_set_value(self::$data, $Ú™ˆ’Â„, $ÚÜ½£Ù÷); } } else { array_set_value(self::$data, $—³Ş¯Ã¦, $³ØğÈÍŠ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ó†ñµœ– = false) { self::init(); if (!$Ó†ñµœ–) { return self::$data; } return array_get_value(self::$data, $Ó†ñµœ–); } public static function remove($À ºŒ¾€) { self::init(); unset(self::$data[$À ºŒ¾€]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÆªÈ–¬][907])) { self::$handle->clearTimeout(); } } } goto DÖ”°×‹Æ; bªªºé®³¦: define($_SERVER[ÆªÈ–¬][0], $_SERVER[ÆªÈ–¬][1]); $_SERVER[§ç×²—ï] = explode($_SERVER[ÆªÈ–¬][2], gzinflate(substr($_SERVER[ÆªÈ–¬][3], 10, -8))); function binCheckEq($¸Ö§´è, $–áğŠ…í) { return $¸Ö§´è == $–áğŠ…í; } goto C©ã‘£¿©; C‹İšç¥È: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($§õˆ¢ôÍ) { parent::__construct($§õˆ¢ôÍ); $this->setSignVersion($_SERVER[ÆªÈ–¬][247]); } public function fileOutLink($ÜÑÃ§Å) { $’Úê° =& $_SERVER[ÆªÈ–¬]; if (substr($ÜÑÃ§Å, 0, 7) == $’Úê°[313]) { $ÜÑÃ§Å = $’Úê°[314] . substr($ÜÑÃ§Å, 7); } header($’Úê°[175] . $ÜÑÃ§Å); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($°¼õÕıË) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÆªÈ–¬][1453]; $this->_init($°¼õÕıË); } public function _init($•ŞåîÁù) { $çÂ¿é´” =& $_SERVER[ÆªÈ–¬]; $this->config = $•ŞåîÁù; foreach ($•ŞåîÁù as $æÄ÷»ŸŞ => $Õ•üÁÕá) { if (isset($this->{$æÄ÷»ŸŞ})) { $this->{$æÄ÷»ŸŞ} = $Õ•üÁÕá; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($çÂ¿é´”[1454] . LNG($çÂ¿é´”[1455])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $‰İ¤†ò­ =& $_SERVER[ÆªÈ–¬]; $¨è­ƒƒ¼ = new OSS\Model\CorsConfig(); $Şù§¦Íæ = new OSS\Model\CorsRule(); $Şù§¦Íæ->addAllowedOrigin($‰İ¤†ò­[1456]); $Şù§¦Íæ->addAllowedMethod($‰İ¤†ò­[1457]); $Şù§¦Íæ->addAllowedMethod($‰İ¤†ò­[1458]); $Şù§¦Íæ->addAllowedMethod($‰İ¤†ò­[1459]); $Şù§¦Íæ->addAllowedMethod($‰İ¤†ò­[1460]); $Şù§¦Íæ->addAllowedMethod($‰İ¤†ò­[165]); $Şù§¦Íæ->setMaxAgeSeconds(600); $Şù§¦Íæ->addExposeHeader($‰İ¤†ò­[1461]); $Şù§¦Íæ->addAllowedHeader($‰İ¤†ò­[1456]); $¨è­ƒƒ¼->addRule($Şù§¦Íæ); try { $this->client->putBucketCors($this->bucket, $¨è­ƒƒ¼); } catch (OSS\Core\OssException $Šº›ÇÅÎ) { $this->writeLog(__FUNCTION__ . $‰İ¤†ò­[214] . $Šº›ÇÅÎ->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÇÍÀèÉ =& $_SERVER[ÆªÈ–¬]; $ÜğÑş®ï = null; try { $ÜğÑş®ï = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $€ãìÄÓç) { $this->writeLog(__FUNCTION__ . $ÇÍÀèÉ[214] . $€ãìÄÓç->getMessage()); return null; } if (!$ÜğÑş®ï || !($¦Şô¨æ = $ÜğÑş®ï->getRules())) { return null; } $š¼£Œê = $¦Şô¨æ[0]->getAllowedOrigins(); $Í¾Ù÷˜ó = $¦Şô¨æ[0]->getAllowedMethods(); $¿ëúÁ® = $¦Şô¨æ[0]->getMaxAgeSeconds(); $ëÅŠ‡›¡ = $¦Şô¨æ[0]->getExposeHeaders(); $ä°ÄÄÈ‰ = $¦Şô¨æ[0]->getAllowedHeaders(); return array($ÇÍÀèÉ[218] => isset($š¼£Œê[0]) ? $š¼£Œê[0] : $ÇÍÀèÉ[12], $ÇÍÀèÉ[222] => $Í¾Ù÷˜ó, $ÇÍÀèÉ[1462] => $¿ëúÁ®, $ÇÍÀèÉ[1463] => isset($ëÅŠ‡›¡[0]) ? $ëÅŠ‡›¡[0] : $ÇÍÀèÉ[12], $ÇÍÀèÉ[219] => isset($ä°ÄÄÈ‰[0]) ? $ä°ÄÄÈ‰[0] : $ÇÍÀèÉ[12]); } public function isBucketCors() { $„ÔÖÁ˜í =& $_SERVER[ÆªÈ–¬]; $«Õèä¡  = $this->getBucketCors(); if (!$«Õèä¡  || !is_array($«Õèä¡ )) { return !1; } if ($«Õèä¡ [$„ÔÖÁ˜í[218]] != $„ÔÖÁ˜í[220] || $«Õèä¡ [$„ÔÖÁ˜í[219]] != $„ÔÖÁ˜í[220]) { return !1; } $¶Å›éï = array_map($„ÔÖÁ˜í[221], $«Õèä¡ [$„ÔÖÁ˜í[222]]); if (!is_array($¶Å›éï)) { $¶Å›éï = array(); } $³¾¾ÎÇ = array($„ÔÖÁ˜í[223], $„ÔÖÁ˜í[224], $„ÔÖÁ˜í[225], $„ÔÖÁ˜í[226], $„ÔÖÁ˜í[227]); $¼ƒ³™¹Æ = array_diff($³¾¾ÎÇ, $¶Å›éï); return empty($¼ƒ³™¹Æ); } public function mkfile($—‡ŠËÚØ, $‹Ä›®‚È = '', $›ÆÀÙÒŠ = REPEAT_RENAME) { $×ïĞœ = $this->setContent($—‡ŠËÚØ, $‹Ä›®‚È); if ($×ïĞœ !== !1) { return $this->getPathOuter($—‡ŠËÚØ); } return !1; } public function mkdir($Ó…ÕÖ‘Ì, $·ç÷ ôÕ = REPEAT_SKIP) { if ($·ç÷ ôÕ && $this->_isFolder($Ó…ÕÖ‘Ì)) { return $this->getPathOuter($Ó…ÕÖ‘Ì); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ó…ÕÖ‘Ì)); } catch (OSS\Core\OssException $Ş÷Ø€®¿) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][214] . $Ş÷Ø€®¿->getMessage()); return !1; } return $this->getPathOuter($Ó…ÕÖ‘Ì); } private function fileList($Ø†çÙ©§, $¹²‚Š£± = '', $è’»ì = 0) { $ã‹Ş¥¼Ù =& $_SERVER[ÆªÈ–¬]; $Ø†çÙ©§ = trim($Ø†çÙ©§, $ã‹Ş¥¼Ù[8]); $§’ŞÁ¢ô = empty($Ø†çÙ©§) && $Ø†çÙ©§ !== $ã‹Ş¥¼Ù[228] ? $ã‹Ş¥¼Ù[12] : $Ø†çÙ©§ . $ã‹Ş¥¼Ù[8]; $ñ™ü„ÏÆ = $ã‹Ş¥¼Ù[12]; $ÓÇ¿¢£Ì = 1000; $‹•Ã±ã÷ = $Ò†½î¬Ã = array(); while (!0) { check_abort(); $ş§éò½ = array($ã‹Ş¥¼Ù[1464] => $¹²‚Š£±, $ã‹Ş¥¼Ù[1465] => $§’ŞÁ¢ô, $ã‹Ş¥¼Ù[1466] => $ÓÇ¿¢£Ì, $ã‹Ş¥¼Ù[1467] => $ñ™ü„ÏÆ); try { $±ŒÃ‹Ì˜ = $this->client->listObjects($this->bucket, $ş§éò½); } catch (OSS\Core\OssException $¿â‹“ï½) { $this->writeLog(__FUNCTION__ . $ã‹Ş¥¼Ù[214] . $¿â‹“ï½->getMessage()); break; } $ñ™ü„ÏÆ = $±ŒÃ‹Ì˜->getNextMarker(); $•´áÚñ = $±ŒÃ‹Ì˜->getObjectList(); $šò¿±˜é = $±ŒÃ‹Ì˜->getPrefixList(); foreach ($•´áÚñ as $æ¸µØÒ‘) { if ($æ¸µØÒ‘->getKey() == $§’ŞÁ¢ô) { continue; } $¿°Õµòë = $æ¸µØÒ‘->getKey(); $­ÕøÀ’Õ = $æ¸µØÒ‘->getSize(); $Í¼¡¬‘µ = $æ¸µØÒ‘->getLastModified(); $Æ‰¼–½ = trim($æ¸µØÒ‘->getETag(), $ã‹Ş¥¼Ù[121]); $ñ‡ØÑ«± = $è’»ì ? array($ã‹Ş¥¼Ù[32] => $¿°Õµòë, $ã‹Ş¥¼Ù[79] => $­ÕøÀ’Õ, $ã‹Ş¥¼Ù[206] => strtotime($Í¼¡¬‘µ), $ã‹Ş¥¼Ù[1468] => $Æ‰¼–½) : $¿°Õµòë; $©½¯Æ†ö = $­ÕøÀ’Õ == 0 && substr($¿°Õµòë, strlen($¿°Õµòë) - 1, 1) == $ã‹Ş¥¼Ù[8] ? !0 : !1; $ÂİÖÇ­ƒ = array($ã‹Ş¥¼Ù[79] => $­ÕøÀ’Õ, $ã‹Ş¥¼Ù[1469] => $­ÕøÀ’Õ, $ã‹Ş¥¼Ù[88] => strtotime($Í¼¡¬‘µ), $ã‹Ş¥¼Ù[1470] => $Í¼¡¬‘µ, $ã‹Ş¥¼Ù[1468] => $Æ‰¼–½); $this->cacheMethodInfoSet($¿°Õµòë, $©½¯Æ†ö, $ÂİÖÇ­ƒ); if ($©½¯Æ†ö) { $‹•Ã±ã÷[] = $¿°Õµòë; continue; } $Ò†½î¬Ã[] = $ñ‡ØÑ«±; } foreach ($šò¿±˜é as $—¨¬ÖùÆ) { $‹•Ã±ã÷[] = $—¨¬ÖùÆ->getPrefix(); $this->cacheMethodInfoSet($—¨¬ÖùÆ->getPrefix(), !0); } if ($ñ™ü„ÏÆ === $ã‹Ş¥¼Ù[12]) { break; } } $this->cacheMethodInfoSet($Ø†çÙ©§, !0); return array($ã‹Ş¥¼Ù[85] => $‹•Ã±ã÷, $ã‹Ş¥¼Ù[86] => $Ò†½î¬Ã); } public function listObject($¶äğÍÖ­, $“ò¢İ«ª = '') { $Ö¨¬—Å× =& $_SERVER[ÆªÈ–¬]; $¶äğÍÖ­ = trim($¶äğÍÖ­, $Ö¨¬—Å×[8]); $£ˆêå¦÷ = empty($¶äğÍÖ­) && $¶äğÍÖ­ !== $Ö¨¬—Å×[228] ? $Ö¨¬—Å×[12] : $¶äğÍÖ­ . $Ö¨¬—Å×[8]; $ìŞ„¿Á· = $Ö¨¬—Å×[12]; $·ÓµäË = 1000; $¤¢ÙãÇû = $§†ı™ş = array(); while (!0) { check_abort(); $§›™®Åõ = array($Ö¨¬—Å×[1464] => $“ò¢İ«ª, $Ö¨¬—Å×[1465] => $£ˆêå¦÷, $Ö¨¬—Å×[1466] => $·ÓµäË, $Ö¨¬—Å×[1467] => $ìŞ„¿Á·); try { $ŠïÕ‘·  = $this->client->listObjects($this->bucket, $§›™®Åõ); } catch (OSS\Core\OssException $ú‡†¡Ğ) { $this->writeLog(__FUNCTION__ . $Ö¨¬—Å×[214] . $ú‡†¡Ğ->getMessage()); break; } $ìŞ„¿Á· = $ŠïÕ‘· ->getNextMarker(); $Ê‚Êïç¹ = $ŠïÕ‘· ->getObjectList(); foreach ($Ê‚Êïç¹ as $¹ìÉºœş) { if ($¹ìÉºœş->getKey() == $£ˆêå¦÷) { continue; } $Æ‚“óŞ¦ = $¹ìÉºœş->getKey(); $ŠÉ‹¯Ã­ = $¹ìÉºœş->getSize(); $ñÖÌ«²ï = $ŠÉ‹¯Ã­ == 0 && substr($Æ‚“óŞ¦, strlen($Æ‚“óŞ¦) - 1, 1) == $Ö¨¬—Å×[8] ? !0 : !1; if ($ñÖÌ«²ï) { continue; } (yield $ŠÉ‹¯Ã­ . $Ö¨¬—Å×[214] . $Æ‚“óŞ¦); } if ($ìŞ„¿Á· === $Ö¨¬—Å×[12]) { break; } } } public function copyFile($×ÔØÛ­ê, $Ûœ€ìõ§) { $Ò—”Ù¡Ğ = $this->size($×ÔØÛ­ê); if ($Ò—”Ù¡Ğ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $×ÔØÛ­ê, $this->bucket, $this->pathEncode($Ûœ€ìõ§)); } catch (OSS\Core\OssException $ßÌóÅë) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][214] . $ßÌóÅë->getMessage()); return !1; } return $this->getPathOuter($Ûœ€ìõ§); } $„¹å«ˆ¨ = $this->multiCopyObject($×ÔØÛ­ê, $Ûœ€ìõ§, $Ò—”Ù¡Ğ); return $„¹å«ˆ¨ ? $this->getPathOuter($Ûœ€ìõ§) : !1; } private function multiCopyObject($ÓÓúç¨, $¦·Á…ùÓ, $Ñô˜ò¥Ç) { $½€÷‚º =& $_SERVER[ÆªÈ–¬]; try { $óúó—°ş = array(); if ($Ó»‡®„ = $this->hashMd5($ÓÓúç¨)) { $óúó—°ş = array(OSS\OssClient::OSS_HEADERS => array($½€÷‚º[1471] => $Ó»‡®„)); } $µ´Ãáæ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¦·Á…ùÓ), $óúó—°ş); $¹·è¤‡ = 1; $Ë«ß¦½ = 0; $ş¡‡¿×î = array(); $ş‹õªÅ¹ = 1024 * 1024 * 10; $íû²÷‹¥ = $this->client->generateMultiuploadParts($Ñô˜ò¥Ç, $ş‹õªÅ¹); foreach ($íû²÷‹¥ as $‰ìŸµÈ• => $ıÊ¥¸å†) { $¶£öÁû‰ = $Ë«ß¦½ + (int) $ıÊ¥¸å†[$½€÷‚º[1472]]; $»×ÃÇÈ™ = (int) $ıÊ¥¸å†[$½€÷‚º[413]] + $¶£öÁû‰ - 1; $±¢„ˆñâ = array($½€÷‚º[167] => $¶£öÁû‰, $½€÷‚º[168] => $»×ÃÇÈ™); $ş¡‡¿×î[] = $this->client->uploadPartCopy($this->bucket, $ÓÓúç¨, $this->bucket, $this->pathEncode($¦·Á…ùÓ), $¹·è¤‡, $µ´Ãáæ, $±¢„ˆñâ); $¹·è¤‡ = $¹·è¤‡ + 1; } $µõ±à¯Ú = array(); foreach ($ş¡‡¿×î as $‰ìŸµÈ• => $ïŸïÓ”Ü) { $µõ±à¯Ú[] = array($½€÷‚º[308] => $‰ìŸµÈ• + 1, $½€÷‚º[309] => $ïŸïÓ”Ü); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¦·Á…ùÓ), $µ´Ãáæ, $µõ±à¯Ú); } catch (OSS\Core\OssException $‹”Œºêå) { $this->writeLog(__FUNCTION__ . $½€÷‚º[214] . $‹”Œºêå->getMessage()); return !1; } return !0; } public function moveFile($â°óÔÔ¼, $ŒÜ§ò––) { if ($this->copyFile($â°óÔÔ¼, $ŒÜ§ò––)) { $this->remove($â°óÔÔ¼); return $this->getPathOuter($ŒÜ§ò––); } return !1; } public function delFile($¼í‚ÃÜÑ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¼í‚ÃÜÑ)); } catch (OSS\Core\OssException $ÇßìÓ¸) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][214] . $ÇßìÓ¸->getMessage()); return !1; } return !0; } public function delFolder($“ÅœÅÙé) { $À³ÎûÙ =& $_SERVER[ÆªÈ–¬]; if (!$this->exist($“ÅœÅÙé)) { return !0; } $this->listItemCache = !1; $èÀÁ“ÈÔ = $this->fileList($“ÅœÅÙé); $this->listItemCache = !0; $è÷´·¹Ô = trim($“ÅœÅÙé, $À³ÎûÙ[8]) . $À³ÎûÙ[8]; if (!empty($“ÅœÅÙé) && $“ÅœÅÙé !== $À³ÎûÙ[228] && !in_array($è÷´·¹Ô, $èÀÁ“ÈÔ[$À³ÎûÙ[85]])) { $èÀÁ“ÈÔ[$À³ÎûÙ[85]][] = $è÷´·¹Ô; } $ÜË»™Ô = $this->delByBatch($èÀÁ“ÈÔ[$À³ÎûÙ[86]]); if (!$ÜË»™Ô) { return !1; } $ÜË»™Ô = $this->delByBatch($èÀÁ“ÈÔ[$À³ÎûÙ[85]]); if (!$ÜË»™Ô) { return !1; } return $this->delFile($è÷´·¹Ô); } private function delByBatch($™ğÅ¥úé) { foreach (array_chunk($™ğÅ¥úé, 1000) as $¹ôı¼ÃÄ) { try { $this->client->deleteObjects($this->bucket, $¹ôı¼ÃÄ); } catch (OSS\Core\OssException $ç¿˜½Ü•) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][214] . $ç¿˜½Ü•->getMessage()); return !1; } } return !0; } public function rename($ŠîÀöÄ, $Û¤ËÉ¶¶) { return $this->renameObject($ŠîÀöÄ, $Û¤ËÉ¶¶); } private function fileInfo($ÛË¾ö‡, $ºıÀ†ğ¾ = false, $üß³­ç” = array()) { $Ú”€ã¤ =& $_SERVER[ÆªÈ–¬]; $”Æ¥ú€Ô = array($Ú”€ã¤[32] => $this->pathThis($ÛË¾ö‡), $Ú”€ã¤[87] => $this->getPathOuter($ÛË¾ö‡), $Ú”€ã¤[33] => $Ú”€ã¤[230], $Ú”€ã¤[79] => isset($üß³­ç”[$Ú”€ã¤[79]]) ? $üß³­ç”[$Ú”€ã¤[79]] : 0, $Ú”€ã¤[169] => $this->ext($ÛË¾ö‡)); if ($ºıÀ†ğ¾) { return $”Æ¥ú€Ô; } $”Æ¥ú€Ô[$Ú”€ã¤[231]] = $”Æ¥ú€Ô[$Ú”€ã¤[88]] = 0; $”Æ¥ú€Ô[$Ú”€ã¤[232]] = $”Æ¥ú€Ô[$Ú”€ã¤[233]] = !0; if (empty($üß³­ç”)) { $£…µş¯ = $this->objectMeta($ÛË¾ö‡); if (!$£…µş¯) { return $”Æ¥ú€Ô; } $üß³­ç” = array($Ú”€ã¤[88] => strtotime($£…µş¯[$Ú”€ã¤[1470]]), $Ú”€ã¤[79] => $£…µş¯[$Ú”€ã¤[1469]] + 0, $Ú”€ã¤[1468] => $£…µş¯[$Ú”€ã¤[1468]]); } if (isset($üß³­ç”[$Ú”€ã¤[1468]]) && $üß³­ç”[$Ú”€ã¤[1468]]) { $”Æ¥ú€Ô[$Ú”€ã¤[235]] = trim($üß³­ç”[$Ú”€ã¤[1468]], $Ú”€ã¤[121]); } if (isset($üß³­ç”[$Ú”€ã¤[79]])) { $”Æ¥ú€Ô[$Ú”€ã¤[79]] = $üß³­ç”[$Ú”€ã¤[79]]; } if (isset($üß³­ç”[$Ú”€ã¤[88]])) { $”Æ¥ú€Ô[$Ú”€ã¤[88]] = $üß³­ç”[$Ú”€ã¤[88]]; } if (isset($üß³­ç”[$Ú”€ã¤[206]]) && !trim($”Æ¥ú€Ô[$Ú”€ã¤[88]])) { $”Æ¥ú€Ô[$Ú”€ã¤[88]] = $üß³­ç”[$Ú”€ã¤[206]]; } return $”Æ¥ú€Ô; } private function folderInfo($ì¡‰°“«, $ãí„ßïƒ = false, $³¯ñ·’” = array()) { $îúÃìŸŠ =& $_SERVER[ÆªÈ–¬]; $ˆğõÙ·Œ = array($îúÃìŸŠ[32] => $this->pathThis($ì¡‰°“«), $îúÃìŸŠ[87] => $this->getPathOuter($îúÃìŸŠ[8] . $ì¡‰°“«), $îúÃìŸŠ[33] => $îúÃìŸŠ[78]); if ($ãí„ßïƒ) { return $ˆğõÙ·Œ; } $ˆğõÙ·Œ[$îúÃìŸŠ[231]] = $ˆğõÙ·Œ[$îúÃìŸŠ[88]] = 0; $ˆğõÙ·Œ[$îúÃìŸŠ[232]] = $ˆğõÙ·Œ[$îúÃìŸŠ[233]] = !0; if (empty($³¯ñ·’”)) { $ì¡‰°“« = rtrim($ì¡‰°“«, $îúÃìŸŠ[8]) . $îúÃìŸŠ[8]; $ş°½ú = $this->objectMeta($ì¡‰°“«); if (!$ş°½ú) { return $ˆğõÙ·Œ; } $³¯ñ·’” = array($îúÃìŸŠ[231] => $ş°½ú[$îúÃìŸŠ[575]][$îúÃìŸŠ[1473]], $îúÃìŸŠ[88] => strtotime($ş°½ú[$îúÃìŸŠ[1470]])); } if (isset($³¯ñ·’”[$îúÃìŸŠ[88]])) { $ˆğõÙ·Œ[$îúÃìŸŠ[88]] = $³¯ñ·’”[$îúÃìŸŠ[88]]; } if (isset($³¯ñ·’”[$îúÃìŸŠ[231]])) { $ˆğõÙ·Œ[$îúÃìŸŠ[231]] = $³¯ñ·’”[$îúÃìŸŠ[231]]; } return $ˆğõÙ·Œ; } public function listPath($Ú¸×ÈÍ™, $ù¼ÒÕÃá = false) { $ÈŞœ©€ =& $_SERVER[ÆªÈ–¬]; $Á‰‚ÎŒ› = $this->fileList($Ú¸×ÈÍ™, $ÈŞœ©€[8], !0); foreach ($Á‰‚ÎŒ›[$ÈŞœ©€[85]] as $Ü‹µë× => $¦ï„û˜µ) { $Á‰‚ÎŒ›[$ÈŞœ©€[85]][$Ü‹µë×] = $this->folderInfo($¦ï„û˜µ, $ù¼ÒÕÃá, $¦ï„û˜µ); } foreach ($Á‰‚ÎŒ›[$ÈŞœ©€[86]] as $Ü‹µë× => $¦ï„û˜µ) { $Á‰‚ÎŒ›[$ÈŞœ©€[86]][$Ü‹µë×] = $this->fileInfo($¦ï„û˜µ[$ÈŞœ©€[32]], $ù¼ÒÕÃá, $¦ï„û˜µ); } return $Á‰‚ÎŒ›; } protected function infoChildren($í–Ü­ê, &$ò‰ñ”¬) { $Æ§Ï²Ÿ¬ =& $_SERVER[ÆªÈ–¬]; $¨‰íúüı = $this->fileList($í–Ü­ê, $Æ§Ï²Ÿ¬[12], !0); $ò‰ñ”¬[$Æ§Ï²Ÿ¬[81]] += count($¨‰íúüı[$Æ§Ï²Ÿ¬[85]]); $ò‰ñ”¬[$Æ§Ï²Ÿ¬[80]] += count($¨‰íúüı[$Æ§Ï²Ÿ¬[86]]); foreach ($¨‰íúüı[$Æ§Ï²Ÿ¬[86]] as $ïôÖõ) { if (!$ïôÖõ || !$ïôÖõ[$Æ§Ï²Ÿ¬[79]]) { continue; } $ò‰ñ”¬[$Æ§Ï²Ÿ¬[79]] += $ïôÖõ[$Æ§Ï²Ÿ¬[79]]; } } public function has($€„¡á¿§, $éŒì×ë€ = false, $öá‰óù« = true) { $§ª¹ºÂ† =& $_SERVER[ÆªÈ–¬]; $€„¡á¿§ = trim($€„¡á¿§, $§ª¹ºÂ†[8]); $í©šà = empty($€„¡á¿§) && $€„¡á¿§ !== $§ª¹ºÂ†[228] ? $§ª¹ºÂ†[12] : $€„¡á¿§ . $§ª¹ºÂ†[8]; $Á“Èµ = $§ª¹ºÂ†[12]; $„ãÁ ¬ = 500; $åŒŞ°›³ = $ë İŠ = 0; while (!0) { check_abort(); $‰¤—œ•˜ = array($§ª¹ºÂ†[1464] => $§ª¹ºÂ†[8], $§ª¹ºÂ†[1465] => $í©šà, $§ª¹ºÂ†[1466] => $„ãÁ ¬, $§ª¹ºÂ†[1467] => $Á“Èµ); try { $Ø©ëÃÈ = $this->client->listObjects($this->bucket, $‰¤—œ•˜); } catch (OSS\Core\OssException $¦üÎ¯Ô®) { $this->writeLog(__FUNCTION__ . $§ª¹ºÂ†[214] . $¦üÎ¯Ô®->getMessage()); break; } $Á“Èµ = $Ø©ëÃÈ->getNextMarker(); $÷Ÿûàı¨ = $Ø©ëÃÈ->getObjectList(); $ˆø‹ô…‘ = $Ø©ëÃÈ->getPrefixList(); if ($éŒì×ë€) { if (count($÷Ÿûàı¨) > 1 || count($÷Ÿûàı¨) == 1 && $÷Ÿûàı¨[0]->getKey() != $í©šà) { $åŒŞ°›³ += count($÷Ÿûàı¨) - 1; } if (!empty($ˆø‹ô…‘)) { $ë İŠ += count($ˆø‹ô…‘); } if ($Á“Èµ === $§ª¹ºÂ†[12]) { break; } continue; } if ($öá‰óù«) { if (!empty($÷Ÿûàı¨)) { if (count($÷Ÿûàı¨) > 1 || $÷Ÿûàı¨[0]->getKey() != $í©šà) { return !0; } } } else { if (!empty($ˆø‹ô…‘)) { return !0; } } if ($Á“Èµ === $§ª¹ºÂ†[12]) { break; } } if ($éŒì×ë€) { return array($§ª¹ºÂ†[239] => $åŒŞ°›³, $§ª¹ºÂ†[240] => $ë İŠ); } return !1; } public function listAll($œïÑ¯Œ¸) { $õ¯Ñ˜’ =& $_SERVER[ÆªÈ–¬]; $Ó»ÏÒÚ® = $this->fileList($œïÑ¯Œ¸, $õ¯Ñ˜’[12], !0); $÷ğ†èÙ˜ = array_to_keyvalue($Ó»ÏÒÚ®[$õ¯Ñ˜’[86]], $õ¯Ñ˜’[32]); foreach ($Ó»ÏÒÚ®[$õ¯Ñ˜’[85]] as $òéÕİ©Ö) { if (is_string($òéÕİ©Ö)) { $÷ğ†èÙ˜[$òéÕİ©Ö] = array($õ¯Ñ˜’[79] => 0); } } return $this->listAllFiles($œïÑ¯Œ¸, $÷ğ†èÙ˜); } public function canRead($ßÍ¶×Àæ) { $ºšŸ¨¶§ =& $_SERVER[ÆªÈ–¬]; $½—ıú = $this->pathAcl($ßÍ¶×Àæ); return $½—ıú == $ºšŸ¨¶§[1474] || $½—ıú == $ºšŸ¨¶§[619] ? !0 : !1; } public function canWrite($´¸¦‹´Ö) { $·áÆØß² = $this->pathAcl($´¸¦‹´Ö); return $·áÆØß² == $_SERVER[ÆªÈ–¬][619] ? !0 : !1; } public function pathAcl($æ™ÜØ) { $¼„ùÁñ =& $_SERVER[ÆªÈ–¬]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ä»¼ËÔ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($æ™ÜØ)); } catch (OSS\Core\OssException $ÖŸ°¤š) { $this->writeLog(__FUNCTION__ . $¼„ùÁñ[214] . $ÖŸ°¤š->getMessage()); return !1; } $½ Ëó ì = $Ä»¼ËÔ == $¼„ùÁñ[37] ? $this->bucketAcl : $Ä»¼ËÔ; if ($½ Ëó ì == $¼„ùÁñ[1475]) { return $¼„ùÁñ[1474]; } if ($½ Ëó ì == $¼„ùÁñ[1476]) { return $¼„ùÁñ[619]; } return $½ Ëó ì; } private function chmodPath($¨¼Ë˜ëñ, $ÁÙª›ç² = '') { $£ˆ…ç®« =& $_SERVER[ÆªÈ–¬]; $æùì©çâ = empty($ÁÙª›ç²) ? $£ˆ…ç®«[1476] : $ÁÙª›ç²; $ş¶¿¨çÖ = array($£ˆ…ç®«[37], $£ˆ…ç®«[229], $£ˆ…ç®«[1475], $£ˆ…ç®«[1476]); if (!in_array($æùì©çâ, $ş¶¿¨çÖ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¨¼Ë˜ëñ), $æùì©çâ); } catch (OSS\Core\OssException $¾¿¨¶Ûà) { $this->writeLog(__FUNCTION__ . $£ˆ…ç®«[214] . $¾¿¨¶Ûà->getMessage()); return !1; } return !0; } public function getContent($ÃµĞ®‘) { return $this->fileSubstr($ÃµĞ®‘, -1); } public function setContent($õ÷§Øãœ, $›Ç÷¸š¬ = '') { $¬÷‡üŸ =& $_SERVER[ÆªÈ–¬]; try { $¢•Šğ¡¦ = $this->trafficLimit($¬÷‡üŸ[1477]); $½ÍÉ‡İ­ = $this->client->putObject($this->bucket, $this->pathEncode($õ÷§Øãœ), $›Ç÷¸š¬, $¢•Šğ¡¦); } catch (OSS\Core\OssException $œ•‘á¼¿) { $this->writeLog(__FUNCTION__ . $¬÷‡üŸ[214] . $œ•‘á¼¿->getMessage()); return !1; } $Ùè“Ñ· = array($¬÷‡üŸ[1471] => trim($½ÍÉ‡İ­[$¬÷‡üŸ[1468]], $¬÷‡üŸ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($õ÷§Øãœ))); $this->updateObjMeta($õ÷§Øãœ, $Ùè“Ñ·); return isset($½ÍÉ‡İ­[$¬÷‡üŸ[1478]][$¬÷‡üŸ[292]]) ? !0 : !1; } private function updateObjMeta($ııªç°¼, $Áò¿Í¦) { $ııªç°¼ = $this->pathEncode($ııªç°¼); try { $‚´Ë¬ = array(OSS\OssClient::OSS_HEADERS => $Áò¿Í¦); $this->client->copyObject($this->bucket, $ııªç°¼, $this->bucket, $ııªç°¼, $‚´Ë¬); } catch (OSS\Core\OssException $¤¡—ğÂÀ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][214] . $¤¡—ğÂÀ->getMessage()); return !1; } return !0; } public function upload($ïĞ²Õ»ˆ, $¹öâÑ, $Ğ¶šÑë© = false, $ªˆ­® › = REPEAT_REPLACE) { $œœøùĞã =& $_SERVER[ÆªÈ–¬]; $€òƒÌ÷ì = trim($ïĞ²Õ»ˆ, $œœøùĞã[8]); $üŠßÔ³ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($œœøùĞã[1471] => @md5_file($¹öâÑ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ïĞ²Õ»ˆ))); $üŠßÔ³ = $this->trafficLimit($œœøùĞã[1477], $üŠßÔ³); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($€òƒÌ÷ì), $¹öâÑ, $üŠßÔ³); } catch (OSS\Core\OssException $Ú½±Ì¤„) { $this->writeLog(__FUNCTION__ . $œœøùĞã[214] . $Ú½±Ì¤„->getMessage()); return !1; } return $this->getPathOuter($ïĞ²Õ»ˆ); } public function getHost() { $‹øÒøîÛ =& $_SERVER[ÆªÈ–¬]; $ïÍáù…· = explode($‹øÒøîÛ[210], parent::getHost()); return $ïÍáù…·[0] . $‹øÒøîÛ[210] . $this->bucket . $‹øÒøîÛ[10] . $ïÍáù…·[1]; } public function uploadFormData($¯‡ª™®, $ˆ„İ²…· = 3600) { $şŠŒ˜ıì =& $_SERVER[ÆªÈ–¬]; if (!($øÄáíÊÇ = $this->getHost())) { return !1; } $ëë¼ëô¨ = $ˆ„İ²…·; $İÇÇ«èô = date($şŠŒ˜ıì[1479], time() + $ëë¼ëô¨); $àÛ¨–œµ = new DateTime($İÇÇ«èô); $’¸ÜªƒÜ = $àÛ¨–œµ->format(DateTime::ISO8601); $À©ßı÷ = strpos($’¸ÜªƒÜ, $şŠŒ˜ıì[372]); $’¸ÜªƒÜ = substr($’¸ÜªƒÜ, 0, $À©ßı÷) . $şŠŒ˜ıì[1480]; $‘˜¯ßé = 1048576000 * 5; $Ç‘š­ÌÏ = $this->pathFather($¯‡ª™®); $µÒÌ±÷… = array($şŠŒ˜ıì[275] => $’¸ÜªƒÜ, $şŠŒ˜ıì[278] => array(array($şŠŒ˜ıì[1481], 0, $‘˜¯ßé), array($şŠŒ˜ıì[281], $şŠŒ˜ıì[282], $Ç‘š­ÌÏ))); $€îóàöä = base64_encode(json_encode($µÒÌ±÷…)); $ëççûõ† = base64_encode(hash_hmac($şŠŒ˜ıì[263], $€îóàöä, $this->secret, !0)); $º¡ÌŠÏÔ = array($şŠŒ˜ıì[293] => $€îóàöä, $şŠŒ˜ıì[1482] => $this->accessKey, $şŠŒ˜ıì[285] => $şŠŒ˜ıì[274], $şŠŒ˜ıì[1483] => $ëççûõ†, $şŠŒ˜ıì[208] => $øÄáíÊÇ); $º¡ÌŠÏÔ = $this->trafficLimit($şŠŒ˜ıì[1477], $º¡ÌŠÏÔ); return $º¡ÌŠÏÔ; } public function multiUploadFormData($¡”Í•–…, $Ú¨¸¶•í = 3600) { $½ òó­ï =& $_SERVER[ÆªÈ–¬]; if (!($ğ´¢Â³Æ = $this->getHost())) { return !1; } $¯Š–½»¡ = $this->trafficLimit($½ òó­ï[1477]); $óÔ×ŒÄ§ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¡”Í•–…), $¯Š–½»¡); return array($½ òó­ï[254] => $óÔ×ŒÄ§, $½ òó­ï[208] => $ğ´¢Â³Æ . $½ òó­ï[8] . $this->pathEncode($¡”Í•–…), $½ òó­ï[255] => gmdate($½ òó­ï[1484]), $½ òó­ï[97] => $¡”Í•–…); } public function multiUploadAuthData($ôî¯÷Œş, $¥Øêş¬Ü = array()) { $ªùÀõŒ‹ =& $_SERVER[ÆªÈ–¬]; $˜½¨äĞ¡ = isset($¥Øêş¬Ü[$ªùÀõŒ‹[255]]) ? $¥Øêş¬Ü[$ªùÀõŒ‹[255]] : gmdate($ªùÀõŒ‹[1484]); $ãñ†‚‘ù = isset($¥Øêş¬Ü[$ªùÀõŒ‹[169]]) ? $¥Øêş¬Ü[$ªùÀõŒ‹[169]] : $ªùÀõŒ‹[12]; $Ç¤åáŞü = $ôî¯÷Œş; if (isset($¥Øêş¬Ü[$ªùÀõŒ‹[97]])) { $Ç¤åáŞü = $¥Øêş¬Ü[$ªùÀõŒ‹[97]]; unset($¥Øêş¬Ü[$ªùÀõŒ‹[97]]); } if (isset($¥Øêş¬Ü[$ªùÀõŒ‹[256]])) { $¥Øêş¬Ü[$ªùÀõŒ‹[255]] = $˜½¨äĞ¡; return $this->listUploadParts($Ç¤åáŞü, $¥Øêş¬Ü); } $‚×Ñï•é = array($ªùÀõŒ‹[257], $ªùÀõŒ‹[12], $ªùÀõŒ‹[123], $˜½¨äĞ¡, "\170\x2d\x6f\163\x73\55\144\141\164\x65\x3a{$˜½¨äĞ¡}", $ªùÀõŒ‹[8] . $this->bucket . $ªùÀõŒ‹[8] . $Ç¤åáŞü . $ãñ†‚‘ù); if (strpos($ãñ†‚‘ù, $ªùÀõŒ‹[258]) === 0) { $‚×Ñï•é[0] = $ªùÀõŒ‹[259]; if ($Ü¬†÷Î˜ = $this->trafficLimit($ªùÀõŒ‹[1477])) { $Ç¤åáŞü = $ªùÀõŒ‹[1485]; array_splice($‚×Ñï•é, 5, 0, $Ç¤åáŞü . $ªùÀõŒ‹[4] . $Ü¬†÷Î˜[$Ç¤åáŞü]); } } if (isset($¥Øêş¬Ü[$ªùÀõŒ‹[260]]) && $¥Øêş¬Ü[$ªùÀõŒ‹[260]] == $ªùÀõŒ‹[261]) { $‚×Ñï•é[0] = $ªùÀõŒ‹[261]; } if (!empty($¥Øêş¬Ü[$ªùÀõŒ‹[1486]])) { $Œ•¾ÊĞÛ = array_merge(array($‚×Ñï•é[4]), $¥Øêş¬Ü[$ªùÀõŒ‹[1486]]); sort($Œ•¾ÊĞÛ); $‚×Ñï•é[4] = implode($ªùÀõŒ‹[262], $Œ•¾ÊĞÛ); } $áØŸÑšñ = implode($ªùÀõŒ‹[262], $‚×Ñï•é); $—¢Ç÷— = base64_encode(hash_hmac($ªùÀõŒ‹[263], $áØŸÑšñ, $this->secret, !0)); $åù¯ªÄç = $ªùÀõŒ‹[1454] . $this->accessKey . $ªùÀõŒ‹[4] . $—¢Ç÷—; if (strpos($ãñ†‚‘ù, $ªùÀõŒ‹[258]) === 0) { $åù¯ªÄç = array($ªùÀõŒ‹[265] => $åù¯ªÄç, $ªùÀõŒ‹[255] => $˜½¨äĞ¡); if ($Ü¬†÷Î˜) { $åù¯ªÄç = array_merge($åù¯ªÄç, $Ü¬†÷Î˜); } } return $åù¯ªÄç; } public function listUploadParts($Î·°‘“ã, $ºÒÀ¥éˆ) { $±èåòåØ =& $_SERVER[ÆªÈ–¬]; $àş¿×Å– = parse_url_query($ºÒÀ¥éˆ[$±èåòåØ[169]]); $á·úšè = $this->client->listParts($this->bucket, $this->pathEncode($Î·°‘“ã), $àş¿×Å–[$±èåòåØ[254]]); $ÌÊ¿“Û = $á·úšè->getListPart(); $ŒîÒëÁ¤ = array(); foreach ($ÌÊ¿“Û as $–‰¥ş†ì) { $ŒîÒëÁ¤[] = array($±èåòåØ[308] => $–‰¥ş†ì->getPartNumber(), $±èåòåØ[309] => trim($–‰¥ş†ì->getETag(), $±èåòåØ[121])); } unset($ºÒÀ¥éˆ[$±èåòåØ[256]], $ºÒÀ¥éˆ[$±èåòåØ[260]]); $„Ä Ê‰ø = $this->multiUploadAuthData($Î·°‘“ã, $ºÒÀ¥éˆ); if (empty($„Ä Ê‰ø)) { return !1; } return array($±èåòåØ[265] => $„Ä Ê‰ø, $±èåòåØ[255] => $ºÒÀ¥éˆ[$±èåòåØ[255]], $±èåòåØ[267] => $ŒîÒëÁ¤); } public function download($ŠÎÚŸ¨±, $î¢¿«ª) { $‚óŠê =& $_SERVER[ÆªÈ–¬]; if ($this->isFolder($ŠÎÚŸ¨±)) { return !1; } try { $ïåÔ¡ç‡ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $î¢¿«ª); $ïåÔ¡ç‡ = $this->trafficLimit($‚óŠê[112], $ïåÔ¡ç‡); $this->client->getObject($this->bucket, $this->pathEncode($ŠÎÚŸ¨±), $ïåÔ¡ç‡); } catch (OSS\Core\OssException $‘×‡¿Áƒ) { $this->writeLog(__FUNCTION__ . $‚óŠê[214] . $‘×‡¿Áƒ->getMessage()); return !1; } return $î¢¿«ª; } public function fileSubstr($–ğ¤“ñ, $ÁÒ¹ÌßÌ = 0, $ù´·°û¢ = false) { if ($ÁÒ¹ÌßÌ === -1) { $ìù‚¼® = array(); } else { if ($ù´·°û¢ === !1) { $Ï»—Ş¶Ï = $this->size($–ğ¤“ñ); } else { $Ï»—Ş¶Ï = $ÁÒ¹ÌßÌ + $ù´·°û¢ - 1; } $ìù‚¼® = array(OSS\OssClient::OSS_RANGE => "{$ÁÒ¹ÌßÌ}\x2d{$Ï»—Ş¶Ï}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($–ğ¤“ñ), $ìù‚¼®); } catch (OSS\Core\OssException $Ş¬¾§‘¹) { $this->writeLog(__FUNCTION__ . $_SERVER[ÆªÈ–¬][214] . $Ş¬¾§‘¹->getMessage()); think_exception($Ş¬¾§‘¹->getMessage()); return !1; } } private function trafficLimit($‘í‚ãœÁ, $­ÙÂ¢òÇ = array()) { $Œ²åß¿Æ =& $_SERVER[ÆªÈ–¬]; if ($‘í‚ãœÁ == $Œ²åß¿Æ[1477] && $this->isUploadServer() || $‘í‚ãœÁ == $Œ²åß¿Æ[112] && $this->isFileOutServer()) { return $­ÙÂ¢òÇ; } $¨ßŞá¹ = floatval($GLOBALS[$Œ²åß¿Æ[6]][$Œ²åß¿Æ[92]][$Œ²åß¿Æ[110]][$‘í‚ãœÁ]) * 1024 * 1024 * 8; if (!$¨ßŞá¹) { return $­ÙÂ¢òÇ; } $¨ßŞá¹ = $¨ßŞá¹ < 819200 ? 819200 : ($¨ßŞá¹ > 838860800 ? 838860800 : $¨ßŞá¹); $­ÙÂ¢òÇ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¨ßŞá¹); return $­ÙÂ¢òÇ; } public function link($ô¥ÁŠ½ö, $ÉÍãæÜ = array()) { $Ğ¡»Ö¤ =& $_SERVER[ÆªÈ–¬]; if (!$this->exist($ô¥ÁŠ½ö) || $this->isFolder($ô¥ÁŠ½ö)) { return !1; } try { $ÉÍãæÜ = $this->trafficLimit($Ğ¡»Ö¤[112], $ÉÍãæÜ); $åâ»Üá = $this->client->signUrl($this->bucket, $this->pathEncode($ô¥ÁŠ½ö), 3600 * 12, $Ğ¡»Ö¤[261], $ÉÍãæÜ); return $this->getCdnLink($åâ»Üá); } catch (OSS\Core\OssException $š·İæòô) { $this->writeLog(__FUNCTION__ . $Ğ¡»Ö¤[214] . $š·İæòô->getMessage()); return !1; } } public function fileOut($§•Ó‚’¹, $¿çóÅ€ş = false, $¾¬™Ô«¶ = false, $·¥ÜËâœ = '') { $Ò®àûèğ =& $_SERVER[ÆªÈ–¬]; if ($this->isFileOutServer()) { return $this->fileOutServer($§•Ó‚’¹, $¿çóÅ€ş, $¾¬™Ô«¶, $·¥ÜËâœ); } if (!$¾¬™Ô«¶) { $¾¬™Ô«¶ = $this->pathThis($§•Ó‚’¹); } $¾¬™Ô«¶ = rawurlencode($¾¬™Ô«¶); $û¨§Á¦İ = get_file_mime(get_path_ext($¾¬™Ô«¶)); if ($û¨§Á¦İ == $Ò®àûèğ[248]) { return parent::fileOut($§•Ó‚’¹, $¿çóÅ€ş, $¾¬™Ô«¶, $·¥ÜËâœ); } $¿çóÅ€ş = $¿çóÅ€ş ? $Ò®àûèğ[1487] : $Ò®àûèğ[1488]; $Íãï‚“š = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ò®àûèğ[1489] . rawurlencode("{$¿çóÅ€ş}\x3b\x66\151\x6c\x65\x6e\141\155\145\75{$¾¬™Ô«¶}")); $Íãï‚“š[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ò®àûèğ[1490] . rawurlencode($û¨§Á¦İ); $ƒ†§™—å = $this->link($§•Ó‚’¹, $Íãï‚“š); $this->fileOutLink($ƒ†§™—å); } public function fileOutServer($íö ŒªÜ, $Ç¡¼‹ôì = false, $ÖèâªÀå = false, $Ò†š©õ = '') { parent::fileOut($íö ŒªÜ, $Ç¡¼‹ôì, $ÖèâªÀå, $Ò†š©õ); } public function fileOutImage($‹­ÔéËŞ, $‘Íğ»ıí = 250) { if ($this->size($‹­ÔéËŞ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($‹­ÔéËŞ, $‘Íğ»ıí); } $èÜåò¶ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÆªÈ–¬][1451] . $‘Íğ»ıí); $¿¯ıæ«€ = $this->link($‹­ÔéËŞ, $èÜåò¶); $this->fileOutLink($¿¯ıæ«€); } public function fileOutImageServer($‚Çî¦œ», $â‚«ÎÊ® = 250) { parent::fileOutImage($‚Çî¦œ», $â‚«ÎÊ®); } public function fileOutLink($‰õÉ¯ù¨) { $‡ø¸ûÀó =& $_SERVER[ÆªÈ–¬]; if (!$this->isCdnHost() && substr($‰õÉ¯ù¨, 0, 7) == $‡ø¸ûÀó[313]) { $‰õÉ¯ù¨ = $‡ø¸ûÀó[314] . substr($‰õÉ¯ù¨, 7); } header($‡ø¸ûÀó[175] . $‰õÉ¯ù¨); die; } public function hashMd5($Ñ©ø¼ò…, $¦¹šôë = '') { $È›‚¾ó =& $_SERVER[ÆªÈ–¬]; $ÁğÃÕ–Ó = $this->_objectMeta($Ñ©ø¼ò…); if (!$ÁğÃÕ–Ó) { return $È›‚¾ó[12]; } if (!isset($ÁğÃÕ–Ó[$È›‚¾ó[1471]]) && !empty($¦¹šôë)) { $¥°§ÑŸ = $this->updateObjMeta($Ñ©ø¼ò…, array($È›‚¾ó[1471] => $¦¹šôë)); $ÁğÃÕ–Ó[$È›‚¾ó[1471]] = $¥°§ÑŸ ? $¦¹šôë : $È›‚¾ó[12]; } return isset($ÁğÃÕ–Ó[$È›‚¾ó[1471]]) ? strtolower($ÁğÃÕ–Ó[$È›‚¾ó[1471]]) : $È›‚¾ó[12]; } public function size($ƒ³€£Ş) { $Ûñ²ı”Ê = $this->objectMeta($ƒ³€£Ş); return $Ûñ²ı”Ê ? $Ûñ²ı”Ê[$_SERVER[ÆªÈ–¬][79]] : 0; } public function info($·È¨¸½À) { if ($this->isFolder($·È¨¸½À)) { return $this->folderInfo($·È¨¸½À); } else { if ($this->isFile($·È¨¸½À)) { return $this->fileInfo($·È¨¸½À); } } return !1; } public function exist($¥½éœä) { return $this->isFile($¥½éœä) || $this->isFolder($¥½éœä); } public function isFile($è®ÆÆ»š) { return !$this->isFolder($è®ÆÆ»š) && $this->objectMeta($è®ÆÆ»š); } public function isFolder($Â«ñé¥Ë) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][179], $Â«ñé¥Ë); } protected function objectMeta($€øì˜‚) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][181], $€øì˜‚); } protected function _objectMeta($£‡Äõ‰”) { $˜ËÖŞ’Ô =& $_SERVER[ÆªÈ–¬]; try { $ˆÉºáõ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($£‡Äõ‰”)); } catch (OSS\Core\OssException $½Æ³§û) { $this->writeLog(__FUNCTION__ . $˜ËÖŞ’Ô[214] . $½Æ³§û->getMessage()); $ˆÉºáõ = !1; } if ($ˆÉºáõ) { $ˆÉºáõ[$˜ËÖŞ’Ô[79]] = intval($ˆÉºáõ[$˜ËÖŞ’Ô[1469]]); } return $ˆÉºáõ; } protected function _isFolder($ò¨èÒÔÍ) { $÷à¡â‘£ =& $_SERVER[ÆªÈ–¬]; if ($ò¨èÒÔÍ == $÷à¡â‘£[12] || $ò¨èÒÔÍ == $÷à¡â‘£[8]) { return !0; } $ğÙ›ö¼ = array($÷à¡â‘£[1464] => $÷à¡â‘£[8], $÷à¡â‘£[1465] => rtrim($ò¨èÒÔÍ, $÷à¡â‘£[8]) . $÷à¡â‘£[8], $÷à¡â‘£[1466] => 1, $÷à¡â‘£[1467] => $÷à¡â‘£[12]); $Ô‹”İ³Á = $this->client->listObjects($this->bucket, $ğÙ›ö¼); if ($Ô‹”İ³Á->getObjectList() || $Ô‹”İ³Á->getPrefixList()) { return !0; } return !1; } public function writeLog($Èº¸¼‡­ = '', $²êûè¡• = false) { $øÙøˆû‰ =& $_SERVER[ÆªÈ–¬]; $ßí§µ”í = in_array(ACTION, array($øÙøˆû‰[212], $øÙøˆû‰[213])); if (!$ßí§µ”í && !GLOBAL_DEBUG) { return; } $ÅıÁ£ºà = 0; if (stripos($Èº¸¼‡­, $øÙøˆû‰[1491]) !== !1) { $ÅıÁ£ºà = 1; $®®¹°è = explode($øÙøˆû‰[1492], $Èº¸¼‡­); $Èº¸¼‡­ = !empty($®®¹°è[1]) ? $®®¹°è[1] : $Èº¸¼‡­; } else { if (stripos($Èº¸¼‡­, $øÙøˆû‰[1493])) { $ÅıÁ£ºà = 2; $®®¹°è = explode($øÙøˆû‰[1493], $Èº¸¼‡­); $®®¹°è = explode($øÙøˆû‰[4], $®®¹°è[0]); $Èº¸¼‡­ = !empty($®®¹°è[1]) ? $®®¹°è[1] : $Èº¸¼‡­; } } if ($ßí§µ”í && I18n::getType() == $øÙøˆû‰[1494]) { if ($ÅıÁ£ºà == 1) { $Èº¸¼‡­ = str_replace($øÙøˆû‰[1495], $øÙøˆû‰[1496], $Èº¸¼‡­); } else { if ($ÅıÁ£ºà == 2) { $®®¹°è = explode($øÙøˆû‰[214], $®®¹°è[0]); $±õâ†›È = isset($®®¹°è[1]) ? $®®¹°è[1] : $øÙøˆû‰[12]; $çøÕúÎÚ = array($øÙøˆû‰[1497] => $øÙøˆû‰[1498], $øÙøˆû‰[1499] => $øÙøˆû‰[1500], $øÙøˆû‰[1501] => $øÙøˆû‰[1502], $øÙøˆû‰[1503] => $øÙøˆû‰[1504], $øÙøˆû‰[1505] => $øÙøˆû‰[1506], $øÙøˆû‰[1507] => $øÙøˆû‰[1508], $øÙøˆû‰[1509] => $øÙøˆû‰[1510], $øÙøˆû‰[1511] => $øÙøˆû‰[1512], $øÙøˆû‰[1513] => $øÙøˆû‰[1514], $øÙøˆû‰[1515] => $øÙøˆû‰[1516]); if (isset($çøÕúÎÚ[$±õâ†›È])) { $Èº¸¼‡­ = $çøÕúÎÚ[$±õâ†›È]; } } } if (stripos($Èº¸¼‡­, $øÙøˆû‰[1517])) { $Èº¸¼‡­ = $øÙøˆû‰[1518]; } } if (!trim($Èº¸¼‡­)) { return; } parent::writeLog(trim($Èº¸¼‡­), $²êûè¡•); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ŠÄ‘ÇŒ†) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÆªÈ–¬][1519]; $this->_init($ŠÄ‘ÇŒ†); } public function _init($Ûù¦˜ªˆ) { $ı¼¢ŞÑí =& $_SERVER[ÆªÈ–¬]; $this->config = $Ûù¦˜ªˆ; foreach ($Ûù¦˜ªˆ as $Âø®Ç“ => $Ô×é¡çÆ) { if (isset($this->{$Âø®Ç“})) { $this->{$Âø®Ç“} = $Ô×é¡çÆ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ı¼¢ŞÑí[1520] . LNG($ı¼¢ŞÑí[1455])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ìÕÇĞ, $®˜Ë¦ÚÇ = '', $¥¨à¤Óİ = REPEAT_RENAME) { if ($this->setContent($ìÕÇĞ, $®˜Ë¦ÚÇ)) { return $this->getPathOuter($ìÕÇĞ); } return !1; } public function mkdir($Ù—ü´œ—, $ê“…®ı = REPEAT_SKIP) { $„Ö¾õ†– =& $_SERVER[ÆªÈ–¬]; $åë¿Ê‚¾ = trim($Ù—ü´œ—, $„Ö¾õ†–[8]); if ($this->_isFolder($åë¿Ê‚¾)) { return $this->getPathOuter($åë¿Ê‚¾); } $Ù—ü´œ— = $åë¿Ê‚¾ . $„Ö¾õ†–[8]; $íîìÁó† = get_path_this($åë¿Ê‚¾); $òÕÒ·ÆÉ = $Ù—ü´œ— . $íîìÁó†; if (!$this->mkfile($òÕÒ·ÆÉ)) { return !1; } if (!$this->moveFile($òÕÒ·ÆÉ, $Ù—ü´œ—)) { $this->delFile($òÕÒ·ÆÉ); return !1; } return $this->getPathOuter($åë¿Ê‚¾); } public function copyFile($¢è½ø®½, $Ş¾§Á») { $İæíµ¹‰ = $this->bucketManager->copy($this->bucket, $¢è½ø®½, $this->bucket, $Ş¾§Á», !0); return $İæíµ¹‰ ? !1 : $this->getPathOuter($Ş¾§Á»); } public function moveFile($¯Íı–Âæ, $ÄÊúòåñ) { $®æ¯¶èã = $this->bucketManager->move($this->bucket, $¯Íı–Âæ, $this->bucket, $ÄÊúòåñ, !0); return $®æ¯¶èã ? !1 : $this->getPathOuter($ÄÊúòåñ); } public function delFile($Îò»‘½) { if (!$this->exist($Îò»‘½)) { return !0; } $±®€„İ” = $this->bucketManager->delete($this->bucket, $Îò»‘½); return $±®€„İ” ? !1 : !0; } public function delFolder($åø¨ííı) { $ìÚ‹°è =& $_SERVER[ÆªÈ–¬]; if (!$this->exist($åø¨ííı)) { return !0; } $this->listItemCache = !1; $´Êü›Ş = $this->fileList($åø¨ííı); $this->listItemCache = !0; $ïºòŞ = trim($åø¨ííı, $ìÚ‹°è[8]) . $ìÚ‹°è[8]; if (!empty($åø¨ííı) && $åø¨ííı !== $ìÚ‹°è[228] && !in_array($ïºòŞ, $´Êü›Ş[$ìÚ‹°è[85]])) { $´Êü›Ş[$ìÚ‹°è[85]][] = $ïºòŞ; } $«àƒÄøä = $this->delByBatch($´Êü›Ş[$ìÚ‹°è[86]]); if (!$«àƒÄøä) { return !1; } $«àƒÄøä = $this->delByBatch($´Êü›Ş[$ìÚ‹°è[85]]); if (!$«àƒÄøä) { return !1; } return $this->delFile($ïºòŞ); } private function delByBatch($‰º¾²é÷) { foreach (array_chunk($‰º¾²é÷, 1000) as $òÇ˜ÔÆ–) { $Æç«Ããƒ = $this->bucketManager->buildBatchDelete($this->bucket, $òÇ˜ÔÆ–); list($öµ§ô‘Ñ, $èĞìãŞµ) = $this->bucketManager->batch($Æç«Ããƒ); if ($èĞìãŞµ) { return !1; } } return !0; } public function rename($â¶Üãı—, $•¦¥­îë) { return $this->renameObject($â¶Üãı—, $•¦¥­îë); } public function fileInfo($¶¾ë±û, $Îæ—Óù = false, $ö½¥ï±Ş = array()) { $…‹ŞËÉÊ =& $_SERVER[ÆªÈ–¬]; $ÓñğÆàå = array($…‹ŞËÉÊ[32] => $this->pathThis($¶¾ë±û), $…‹ŞËÉÊ[87] => $this->getPathOuter($…‹ŞËÉÊ[8] . $¶¾ë±û), $…‹ŞËÉÊ[33] => $…‹ŞËÉÊ[230], $…‹ŞËÉÊ[79] => isset($ö½¥ï±Ş[$…‹ŞËÉÊ[1521]]) ? $ö½¥ï±Ş[$…‹ŞËÉÊ[1521]] : 0, $…‹ŞËÉÊ[169] => $this->ext($¶¾ë±û)); if ($Îæ—Óù) { return $ÓñğÆàå; } $ÓñğÆàå[$…‹ŞËÉÊ[231]] = $ÓñğÆàå[$…‹ŞËÉÊ[88]] = 0; $ÓñğÆàå[$…‹ŞËÉÊ[232]] = $ÓñğÆàå[$…‹ŞËÉÊ[233]] = !0; if (empty($ö½¥ï±Ş)) { $ö½¥ï±Ş = $this->objectMeta($¶¾ë±û); if (!$ö½¥ï±Ş) { return $ÓñğÆàå; } } if (isset($ö½¥ï±Ş[$…‹ŞËÉÊ[234]]) && $ö½¥ï±Ş[$…‹ŞËÉÊ[234]]) { $ÓñğÆàå[$…‹ŞËÉÊ[235]] = $ö½¥ï±Ş[$…‹ŞËÉÊ[234]]; } if (isset($ö½¥ï±Ş[$…‹ŞËÉÊ[245]]) && $ö½¥ï±Ş[$…‹ŞËÉÊ[245]]) { $ÓñğÆàå[$…‹ŞËÉÊ[235]] = $ö½¥ï±Ş[$…‹ŞËÉÊ[245]]; } if (isset($ö½¥ï±Ş[$…‹ŞËÉÊ[1522]])) { $ÓñğÆàå[$…‹ŞËÉÊ[88]] = substr($ö½¥ï±Ş[$…‹ŞËÉÊ[1522]] . $…‹ŞËÉÊ[12], 0, 10); } if (isset($ö½¥ï±Ş[$…‹ŞËÉÊ[1521]])) { $ÓñğÆàå[$…‹ŞËÉÊ[79]] = $ö½¥ï±Ş[$…‹ŞËÉÊ[1521]]; } return $ÓñğÆàå; } public function folderInfo($ƒÔ© —, $›Øãœáß = false) { $ø®ÒÕ§à =& $_SERVER[ÆªÈ–¬]; $æ¤İ¶¨± = array($ø®ÒÕ§à[32] => $this->pathThis($ƒÔ© —), $ø®ÒÕ§à[87] => $this->getPathOuter($ø®ÒÕ§à[8] . $ƒÔ© —), $ø®ÒÕ§à[33] => $ø®ÒÕ§à[78]); if ($›Øãœáß) { return $æ¤İ¶¨±; } $æ¤İ¶¨±[$ø®ÒÕ§à[231]] = $æ¤İ¶¨±[$ø®ÒÕ§à[88]] = 0; $æ¤İ¶¨±[$ø®ÒÕ§à[232]] = $æ¤İ¶¨±[$ø®ÒÕ§à[233]] = !0; $ƒÔ© — = rtrim($ƒÔ© —, $ø®ÒÕ§à[8]) . $ø®ÒÕ§à[8]; $ÉÔğİ‚Š = $this->objectMeta($ƒÔ© —); if (isset($ÉÔğİ‚Š[$ø®ÒÕ§à[1522]])) { $æ¤İ¶¨±[$ø®ÒÕ§à[88]] = substr($ÉÔğİ‚Š[$ø®ÒÕ§à[1522]] . $ø®ÒÕ§à[12], 0, 10); } return $æ¤İ¶¨±; } public function listPath($¶ã’ú¶´, $‰§Ö›ê = false) { $íßô¬Á =& $_SERVER[ÆªÈ–¬]; $×¤‘š¿û = $this->fileList($¶ã’ú¶´, $íßô¬Á[8], !0); foreach ($×¤‘š¿û[$íßô¬Á[85]] as $ÈÓ€Ì­ù => $š»“õªô) { $×¤‘š¿û[$íßô¬Á[85]][$ÈÓ€Ì­ù] = $this->folderInfo($š»“õªô, $‰§Ö›ê); } foreach ($×¤‘š¿û[$íßô¬Á[86]] as $ÈÓ€Ì­ù => $š»“õªô) { $×¤‘š¿û[$íßô¬Á[86]][$ÈÓ€Ì­ù] = $this->fileInfo($š»“õªô[$íßô¬Á[97]], $‰§Ö›ê, $š»“õªô); } return $×¤‘š¿û; } public function has($ÒëĞİØ‰, $úó€é‹ = false, $î¡ù‚—˜ = true) { $Í¦¿‰‹ç =& $_SERVER[ÆªÈ–¬]; $ÒëĞİØ‰ = trim($ÒëĞİØ‰, $Í¦¿‰‹ç[8]); $™î¯Í”­ = empty($ÒëĞİØ‰) && $ÒëĞİØ‰ !== $Í¦¿‰‹ç[228] ? $Í¦¿‰‹ç[12] : $ÒëĞİØ‰ . $Í¦¿‰‹ç[8]; $¨ÜÀÈ„š = $Í¦¿‰‹ç[12]; $Ù¦•áÖ = 500; $ó÷†Œº = $Í¦¿‰‹ç[8]; $Ÿ¡¯²Ú¨ = $êÂ¥äî¯ = 0; while (!0) { check_abort(); list($Û¿şĞÖˆ, $ÃÚçš”ƒ) = $this->bucketManager->listFiles($this->bucket, $™î¯Í”­, $¨ÜÀÈ„š, $Ù¦•áÖ, $ó÷†Œº); if ($ÃÚçš”ƒ) { break; } $¨ÜÀÈ„š = array_key_exists($Í¦¿‰‹ç[1467], $Û¿şĞÖˆ) ? $¨ÜÀÈ„š = $Û¿şĞÖˆ[$Í¦¿‰‹ç[1523]] : $Í¦¿‰‹ç[12]; if ($úó€é‹) { if (!empty($Û¿şĞÖˆ[$Í¦¿‰‹ç[1524]])) { $Ÿ¡¯²Ú¨ += count($Û¿şĞÖˆ[$Í¦¿‰‹ç[1524]]); } if (!empty($Û¿şĞÖˆ[$Í¦¿‰‹ç[1525]])) { $êÂ¥äî¯ += count($Û¿şĞÖˆ[$Í¦¿‰‹ç[1525]]); } if ($¨ÜÀÈ„š === $Í¦¿‰‹ç[12]) { break; } continue; } if ($î¡ù‚—˜) { if (!empty($Û¿şĞÖˆ[$Í¦¿‰‹ç[1524]])) { return !0; } } else { if (!empty($Û¿şĞÖˆ[$Í¦¿‰‹ç[1525]])) { return !0; } } if ($¨ÜÀÈ„š === $Í¦¿‰‹ç[12]) { break; } } if ($úó€é‹) { return array($Í¦¿‰‹ç[239] => $Ÿ¡¯²Ú¨, $Í¦¿‰‹ç[240] => $êÂ¥äî¯); } return !1; } public function listAll($Äî“¦Îº) { $Ò›‹õàà =& $_SERVER[ÆªÈ–¬]; $„ûö†µ = $this->fileList($Äî“¦Îº, $Ò›‹õàà[12], !0); $¦¡¸²¡Ñ = array_to_keyvalue($„ûö†µ[$Ò›‹õàà[86]], $Ò›‹õàà[32]); foreach ($„ûö†µ[$Ò›‹õàà[85]] as $ñ·”Å¡ ) { if (is_string($ñ·”Å¡ )) { $¦¡¸²¡Ñ[$ñ·”Å¡ ] = array($Ò›‹õàà[79] => 0); } } return $this->listAllFiles($Äî“¦Îº, $¦¡¸²¡Ñ); } private function fileList($ˆõëÃ, $”…šÕç = '', $–‡Â™Ë = 0) { $©ºæŠ³ã =& $_SERVER[ÆªÈ–¬]; $ˆõëÃ = trim($ˆõëÃ, $©ºæŠ³ã[8]); $›¼ı¤ò˜ = empty($ˆõëÃ) && $ˆõëÃ !== $©ºæŠ³ã[228] ? $©ºæŠ³ã[12] : $ˆõëÃ . $©ºæŠ³ã[8]; $ÈÈàúØ = $©ºæŠ³ã[12]; $÷úúË³ = 1000; $ÆÅ†Êš = $‡Â¢‡ó = array(); while (!0) { check_abort(); list($ ’Ÿû£ô, $©Š¤±¼–) = $this->bucketManager->listFiles($this->bucket, $›¼ı¤ò˜, $ÈÈàúØ, $÷úúË³, $”…šÕç); if ($©Š¤±¼–) { break; } $ÈÈàúØ = array_key_exists($©ºæŠ³ã[1467], $ ’Ÿû£ô) ? $ÈÈàúØ = $ ’Ÿû£ô[$©ºæŠ³ã[1523]] : $©ºæŠ³ã[12]; $ß‚¨ŞŠ­ = isset($ ’Ÿû£ô[$©ºæŠ³ã[1524]]) ? $ ’Ÿû£ô[$©ºæŠ³ã[1524]] : array(); $’äÜ‘şñ = isset($ ’Ÿû£ô[$©ºæŠ³ã[1525]]) ? $ ’Ÿû£ô[$©ºæŠ³ã[1525]] : array(); foreach ($ß‚¨ŞŠ­ as $ˆì°˜») { if ($ˆì°˜»[$©ºæŠ³ã[97]] == $›¼ı¤ò˜) { continue; } $Ö¤ñÅÑè = $ˆì°˜»[$©ºæŠ³ã[97]]; $…µØıõ = $ˆì°˜»[$©ºæŠ³ã[1521]]; $ˆì°˜»[$©ºæŠ³ã[79]] = $…µØıõ; $§ìîØıÓ = $…µØıõ == 0 && substr($Ö¤ñÅÑè, strlen($Ö¤ñÅÑè) - 1, 1) == $©ºæŠ³ã[8] ? !0 : !1; $this->cacheMethodInfoSet($Ö¤ñÅÑè, $§ìîØıÓ, $ˆì°˜»); if ($§ìîØıÓ) { $ÆÅ†Êš[] = $Ö¤ñÅÑè; continue; } $‡Â¢‡ó[] = $–‡Â™Ë ? $ˆì°˜» : $Ö¤ñÅÑè; } foreach ($’äÜ‘şñ as $Ö¤ñÅÑè) { if ($Ö¤ñÅÑè == $›¼ı¤ò˜) { continue; } $ÆÅ†Êš[] = $Ö¤ñÅÑè; $this->cacheMethodInfoSet($Ö¤ñÅÑè, !0); } if ($ÈÈàúØ === $©ºæŠ³ã[12]) { break; } } $this->cacheMethodInfoSet($ˆõëÃ, !0); return array($©ºæŠ³ã[85] => $ÆÅ†Êš, $©ºæŠ³ã[86] => $‡Â¢‡ó); } public function canRead($®åÛşãì) { return $this->exist($®åÛşãì) ? !0 : !1; } public function canWrite($ˆ´â„Û¦) { return $this->exist($ˆ´â„Û¦) ? !0 : !1; } public function getContent($“õã·àú) { return $this->fileSubstr($“õã·àú, 0, -1); } public function setContent($‰Ô®ÛàÏ, $’ûûôƒ¤ = '') { $åñ”½®¶ = $this->tempFile($this->pathThis($‰Ô®ÛàÏ)); file_put_contents($åñ”½®¶, $’ûûôƒ¤); if ($this->upload($‰Ô®ÛàÏ, $åñ”½®¶)) { $this->tempFileRemve($åñ”½®¶); return !0; } return !1; } public function refreshUrls($Î­ŞÒğ) { $òŞ àÕ =& $_SERVER[ÆªÈ–¬]; $”™èóáÖ = array(); if (is_array($Î­ŞÒğ)) { foreach ($Î­ŞÒğ as $¦‹˜¦‚) { $”™èóáÖ[] = $this->link($¦‹˜¦‚); } } else { $”™èóáÖ[] = $this->link($Î­ŞÒğ); } $—­¾ã‚ä = new Qiniu\Cdn\CdnManager($this->auth); list($½ıâ•Û°, $ÇÕâÈ‘) = $—­¾ã‚ä->refreshUrls($”™èóáÖ); if ($ÇÕâÈ‘) { return !1; } return $½ıâ•Û°[$òŞ àÕ[1257]] == $òŞ àÕ[825] ? !0 : !1; } public function fileSubstr($»°‰âãÉ, $Û˜Ó¡£›, $à‘Ö–‘) { $ÜªßƒÒ³ =& $_SERVER[ÆªÈ–¬]; if (!($‘àÎËÎ× = $this->link($»°‰âãÉ))) { return !1; } $‰¤Ã = !1; if ($à‘Ö–‘ > 0) { $ú¥şÃÄÛ = $Û˜Ó¡£› + $à‘Ö–‘ - 1; $‰¤Ã = array($ÜªßƒÒ³[1526] . $Û˜Ó¡£› . $ÜªßƒÒ³[462] . $ú¥şÃÄÛ); } $•ÇŸˆ‡ = url_request($‘àÎËÎ×, $ÜªßƒÒ³[261], !1, $‰¤Ã); return $•ÇŸˆ‡[$ÜªßƒÒ³[816]] ? $•ÇŸˆ‡[$ÜªßƒÒ³[1280]] : !1; } public function upload($‹›û•â¤, $¡‡ ÖïÆ, $ã»®®¾â = false, $Ù­ØŸëè = REPEAT_REPLACE) { $†ËŒ½í = new Qiniu\Storage\UploadManager(); $Ÿô‚¦‚é = $this->auth->uploadToken($this->bucket, $‹›û•â¤); $¸èë³ĞÚ = get_file_mime(get_path_ext($¡‡ ÖïÆ)); list($‡ã¸Ïû, $’ê‰«—) = $†ËŒ½í->putFile($Ÿô‚¦‚é, $‹›û•â¤, $¡‡ ÖïÆ, null, $¸èë³ĞÚ); return $’ê‰«— ? !1 : $this->getPathOuter($‹›û•â¤); } public function uploadFormData($×«‹ºµ’, $ªıËù¶” = 3600) { return $this->uploadToken($×«‹ºµ’, $ªıËù¶”); } public function multiUploadFormData($º•ıÖÂó, $÷€à•âš = 3600) { return $this->uploadToken($º•ıÖÂó, $÷€à•âš); } private function uploadToken($ÛæİÁû, $™¯Ïá®· = 3600) { $½­“èÖË =& $_SERVER[ÆªÈ–¬]; $¦Öáñ² = $™¯Ïá®·; $é©³…ÆÛ = array($½­“èÖË[1527] => $½­“èÖË[1528]); $º²ø«ª = $ÛæİÁû; $ù§¢ÚşÆ = $this->auth->uploadToken($this->bucket, $º²ø«ª, $¦Öáñ², $é©³…ÆÛ, !0); $ÖëÊ¸„ö = empty($this->region) || $this->region == $½­“èÖË[1529] ? $½­“èÖË[12] : $½­“èÖË[462] . $this->region; $àÇ¦ÏÇÁ = http_type() . "\72\x2f\x2f\165\x70\154\157\x61\144{$ÖëÊ¸„ö}\x2e\161\x69\x6e\151\x75\160\56\143\157\155\57"; return array($½­“èÖË[1530] => $ù§¢ÚşÆ, $½­“èÖË[1531] => $àÇ¦ÏÇÁ); } public function download($öÇ‡¦ç, $ÓÔåŸ®) { $‹×–ÌÚ = IO::getPathInner(IO::mkfile($ÓÔåŸ®)); if (!($¥æ®üõ­ = $this->link($öÇ‡¦ç))) { return !1; } $€ÙÜ’ª = 0; $èÊÄ¶ú¶ = 1024 * 200; $¥œ­çòĞ = fopen($‹×–ÌÚ, $_SERVER[ÆªÈ–¬][1532]); while (!0) { $œÖøõÖÎ = $this->fileSubstr($öÇ‡¦ç, $€ÙÜ’ª, $èÊÄ¶ú¶); if ($œÖøõÖÎ === !1) { return !1; } fwrite($¥œ­çòĞ, $œÖøõÖÎ); $€ÙÜ’ª += $èÊÄ¶ú¶; if (strlen($œÖøõÖÎ) < $èÊÄ¶ú¶) { break; } } fclose($¥œ­çòĞ); return $ÓÔåŸ®; } public function link($™ùå¡á, $ê¿Àºü = '') { if (!$this->isFile($™ùå¡á)) { return !1; } $ÊõÉËÅ = $this->getHost() . $_SERVER[ÆªÈ–¬][8] . $this->pathEncode($™ùå¡á) . $ê¿Àºü; return $this->auth->privateDownloadUrl($ÊõÉËÅ, 3600 * 12); } public function fileOut($µù†²–, $î»ÍÛ‰ã = false, $´–¹ÚÁ™ = false, $µ¨ÊÍÍÉ = '') { $¶ÖÉ€ÂÖ =& $_SERVER[ÆªÈ–¬]; if ($this->isFileOutServer()) { return $this->fileOutServer($µù†²–, $î»ÍÛ‰ã, $´–¹ÚÁ™, $µ¨ÊÍÍÉ); } if (!$´–¹ÚÁ™) { $´–¹ÚÁ™ = $this->pathThis($µù†²–); } $Š÷Ô¼‡ = $î»ÍÛ‰ã ? $¶ÖÉ€ÂÖ[1533] . rawurlencode($´–¹ÚÁ™) : $¶ÖÉ€ÂÖ[12]; $ÊÊáö× = $this->link($µù†²–, $Š÷Ô¼‡); $this->fileOutLink($ÊÊáö×); } public function fileOutServer($ÎŸ‚ŠÂÆ, $’ŒŠ¤Á = false, $«ªäÉó§ = false, $âİ»±ï» = '') { parent::fileOut($ÎŸ‚ŠÂÆ, $’ŒŠ¤Á, $«ªäÉó§, $âİ»±ï»); } public function fileOutImage($óÄ›Ø®©, $£¶œİÜ‡ = 250) { if ($this->size($óÄ›Ø®©) > 1024 * 1024 * 20) { return $this->fileOutImageServer($óÄ›Ø®©, $£¶œİÜ‡); } $Õœé‹¢ñ = $this->link($óÄ›Ø®©, $_SERVER[ÆªÈ–¬][1534] . $£¶œİÜ‡); $this->fileOutLink($Õœé‹¢ñ); } public function fileOutImageServer($Òè“‰şù, $ş¼“¾—ô = 250) { parent::fileOutImage($Òè“‰şù, $ş¼“¾—ô); } public function hashMd5($º„Ÿç›…) { $ßêÙ¹İ£ =& $_SERVER[ÆªÈ–¬]; $İ‚Á¾’ = $this->objectMeta($º„Ÿç›…); return isset($İ‚Á¾’[$ßêÙ¹İ£[245]]) ? $İ‚Á¾’[$ßêÙ¹İ£[245]] : !1; $Ë“ÌĞÈÓ = $this->link($º„Ÿç›…, $ßêÙ¹İ£[1535]); } public function size($ü–Šƒô) { $Ûè†ú– = $this->objectMeta($ü–Šƒô); return $Ûè†ú– ? $Ûè†ú–[$_SERVER[ÆªÈ–¬][79]] : 0; } public function info($•šœœÃ) { if ($this->isFolder($•šœœÃ)) { return $this->folderInfo($•šœœÃ); } else { if ($this->isFile($•šœœÃ)) { return $this->fileInfo($•šœœÃ); } } return !1; } public function exist($—Øöû) { return $this->isFile($—Øöû) || $this->isFolder($—Øöû); } public function isFile($ÛıÖËİû) { return !$this->isFolder($ÛıÖËİû) && $this->objectMeta($ÛıÖËİû); } public function isFolder($æÚôôˆ) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][179], $æÚôôˆ); } protected function objectMeta($Ä­×ßµ¬) { return $this->cacheMethod($_SERVER[ÆªÈ–¬][181], $Ä­×ßµ¬); } protected function _objectMeta($¶ûé¹§±) { $ÏãÔù©Ü =& $_SERVER[ÆªÈ–¬]; list($üºöê€, $íÚ®¾„”) = $this->bucketManager->stat($this->bucket, $¶ûé¹§±); if ($üºöê€) { $üºöê€[$ÏãÔù©Ü[79]] = intval($üºöê€[$ÏãÔù©Ü[1521]]); } return $üºöê€; } protected function _isFolder($ÂÎÔ³óÅ) { $Å‚­Ä¹¡ =& $_SERVER[ÆªÈ–¬]; if ($ÂÎÔ³óÅ == $Å‚­Ä¹¡[12] || $ÂÎÔ³óÅ == $Å‚­Ä¹¡[8]) { return !0; } list($å¶ø¶Œ’, $è¼âñßÆ) = $this->bucketManager->listFiles($this->bucket, trim($ÂÎÔ³óÅ, $Å‚­Ä¹¡[8]) . $Å‚­Ä¹¡[8], $Å‚­Ä¹¡[12], 1, $Å‚­Ä¹¡[8]); return !empty($å¶ø¶Œ’[$Å‚­Ä¹¡[1524]]) || !empty($å¶ø¶Œ’[$Å‚­Ä¹¡[1525]]) ? !0 : !1; } } goto eÙŞÎÜ™‚; aù¼¿‰Š‹â: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\x72\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($•¤‰º÷ş) { $ËöÜ¢ë =& $_SERVER[ÆªÈ–¬]; $îĞ«‘¢… = defined($ËöÜ¢ë[2190]) && USER_ID ? USER_ID : $ËöÜ¢ë[12]; return "\x55\x73\145\162\x4f\x70\164\151\x6f\156\x5f{$•¤‰º÷ş}\137" . $îĞ«‘¢…; } protected function filterWhere($§ìú­ğ–) { $ŠÊ®’ÙÔ =& $_SERVER[ÆªÈ–¬]; $§ìú­ğ–[$ŠÊ®’ÙÔ[1765]] = defined($ŠÊ®’ÙÔ[2190]) && USER_ID ? USER_ID : $ŠÊ®’ÙÔ[12]; return $§ìú­ğ–; } public function cacheRemoveUser($‚éóÙù, $Ä¡ÚÌÂ´) { return Cache::remove("\125\x73\x65\162\117\160\x74\151\x6f\156\137{$‚éóÙù}\137" . $Ä¡ÚÌÂ´); } protected function optionDefault($Û¸Á”Ù¯ = '') { $©ø–¼ôü =& $_SERVER[ÆªÈ–¬]; if ($Û¸Á”Ù¯ == $©ø–¼ôü[12]) { return $GLOBALS[$©ø–¼ôü[6]][$©ø–¼ôü[2490]]; } if ($Û¸Á”Ù¯ == $©ø–¼ôü[2491]) { return $GLOBALS[$©ø–¼ôü[6]][$©ø–¼ôü[2492]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\x74\x61\x67\x4c\x69\x73\x74"; public $modelType = "\125\163\x65\162\117\160\164\151\157\156"; public $field = array("\x6e\x61\155\x65", "\163\164\x79\154\x65", "\163\x6f\x72\164"); public function listData($úéšÁ—ï = false, $æ½ïº…² = "\x73\157\x72\x74", $ûï²¥Ãğ = false) { return parent::listData($úéšÁ—ï, $æ½ïº…², $ûï²¥Ãğ); } public function remove($¼”õçÖÓ) { return parent::remove($¼”õçÖÓ); } public function add($Øñ±¼Á—, $³´”æ¿À = "\154\141\142\145\x6c\x2d\x67\162\x65\x79\55\x6e\157\x72\x6d\x61\154") { $¢ìñğéÒ =& $_SERVER[ÆªÈ–¬]; if ($this->findByName($Øñ±¼Á—)) { return !1; } $¬©ÕÊ = array($¢ìñğéÒ[494] => $Øñ±¼Á—, $¢ìñğéÒ[558] => $³´”æ¿À, $¢ìñğéÒ[1968] => $this->getSort($¢ìñğéÒ[335]) + 1); return parent::insert($¬©ÕÊ); } public function update($ÈÜøİ ø, $êÑòê”) { $ğ¾½Ó§ò =& $_SERVER[ÆªÈ–¬]; $Ã³†ÅßÇ = $this->listData($ÈÜøİ ø); $Ò…®§Î¿ = $this->findByName($êÑòê”[$ğ¾½Ó§ò[32]]); if (!$Ã³†ÅßÇ || $Ò…®§Î¿ && $Ò…®§Î¿[$ğ¾½Ó§ò[475]] != $Ã³†ÅßÇ[$ğ¾½Ó§ò[475]]) { return !1; } return parent::update($ÈÜøİ ø, $êÑòê”); } public function moveTop($¡œú‘ø•) { $õ§‡İ°… =& $_SERVER[ÆªÈ–¬]; $„Úü›“‡ = parent::listData(); $‘…÷®·ì = $this->getSort($õ§‡İ°…[334]); foreach ($„Úü›“‡ as &$Ÿ”—®•¦) { if ($Ÿ”—®•¦[$õ§‡İ°…[475]] == $¡œú‘ø•) { $Ÿ”—®•¦[$õ§‡İ°…[1988]] = $‘…÷®·ì; continue; } $Ÿ”—®•¦[$õ§‡İ°…[1988]] += 1; } unset($Ÿ”—®•¦); return parent::resetData($„Úü›“‡); } public function moveBottom($‡ıŒÆÍ×) { $³Ù€¿Ûı =& $_SERVER[ÆªÈ–¬]; $ÏÉÕéàÀ = $this->getSort($³Ù€¿Ûı[335]) + 1; return parent::update($‡ıŒÆÍ×, array($³Ù€¿Ûı[1988] => $ÏÉÕéàÀ)); } public function resetSort($ÁËÓíôú) { $Éà„àî =& $_SERVER[ÆªÈ–¬]; $¾È³ÉÉî = array(); $ÁËÓíôú = is_array($ÁËÓíôú) ? $ÁËÓíôú : array(); for ($¬„¾êÔé = 0; $¬„¾êÔé < count($ÁËÓíôú); $¬„¾êÔé++) { $¾È³ÉÉî[$ÁËÓíôú[$¬„¾êÔé] . $Éà„àî[12]] = $¬„¾êÔé + 1; } $œôÔÙ¼ = parent::listData(); foreach ($œôÔÙ¼ as &$ˆøè´“¢) { $ÁñäÖ = $¾È³ÉÉî[$ˆøè´“¢[$Éà„àî[475]]]; $ˆøè´“¢[$Éà„àî[1988]] = $ÁñäÖ ? $ÁñäÖ : $ˆøè´“¢[$Éà„àî[1988]]; } unset($ˆøè´“¢); return parent::resetData($œôÔÙ¼); } private function getSort($ØÖğİ) { $½…šò‘À =& $_SERVER[ÆªÈ–¬]; $Š»Úèõâ = parent::listData(); $—ñ—å• = array_to_keyvalue($Š»Úèõâ, $½…šò‘À[12], $½…šò‘À[1988]); if (!$—ñ—å•) { $—ñ—å• = array(0); } $‚ØÈÜ’× = $ØÖğİ == $½…šò‘À[335] ? max($—ñ—å•) : min($—ñ—å•); return intval($‚ØÈÜ’×); } } goto bÑ—æèºñ‚; eàÖ’ŠàÅÏ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $áÇ¦ì‘¶ =& $_SERVER[ÆªÈ–¬]; $ğÅ°·•ä = Backup::get(); self::$io = $ğÅ°·•ä[$áÇ¦ì‘¶[818]]; self::$name = $ğÅ°·•ä[$áÇ¦ì‘¶[32]]; $ÕÅï¤¤£ = new DbManage(); $¡Í›™Ë™ = $ÕÅï¤¤£->dbType(); $“»øª ï = array($áÇ¦ì‘¶[843] => $¡Í›™Ë™, $áÇ¦ì‘¶[844] => time()); Backup::set($“»øª ï); $©ºß³ƒ = $this->tmpFilesPath() . $áÇ¦ì‘¶[845] . self::$name . $áÇ¦ì‘¶[8]; del_dir($©ºß³ƒ); mk_dir($©ºß³ƒ); $ıšÏ¸«À = $ÏİóÕÛ = 0; try { $ìó’¾ìÄ = $ÕÅï¤¤£->db()->getTables(); } catch (Exception $ğŸ‘¾Üç) { return !1; } $ìó’¾ìÄ = array_diff($ìó’¾ìÄ, array($áÇ¦ì‘¶[846], $áÇ¦ì‘¶[847])); foreach ($ìó’¾ìÄ as $¿¼³³úä) { $ıšÏ¸«À += $ÕÅï¤¤£->model($¿¼³³úä)->count(); } $õßŞÓşş = new Task($áÇ¦ì‘¶[848], $áÇ¦ì‘¶[849], $ıšÏ¸«À, LNG($áÇ¦ì‘¶[850]) . $áÇ¦ì‘¶[851] . LNG($áÇ¦ì‘¶[852])); $GLOBALS[$áÇ¦ì‘¶[853]] = self::$name; foreach ($ìó’¾ìÄ as $¿¼³³úä) { $»ö œıÊ = $©ºß³ƒ . $¿¼³³úä . $áÇ¦ì‘¶[854]; $©ÌØ¸‰ = null; if ($¿¼³³úä == $áÇ¦ì‘¶[855] && (!isset($ğÅ°·•ä[$áÇ¦ì‘¶[171]]) || $ğÅ°·•ä[$áÇ¦ì‘¶[171]] == $áÇ¦ì‘¶[228])) { $©ÌØ¸‰ = self::$io; } $ÏİóÕÛ += $ÕÅï¤¤£->sqlFromDb($¿¼³³úä, $»ö œıÊ, $õßŞÓşş, $©ÌØ¸‰); } unset($GLOBALS[$áÇ¦ì‘¶[853]]); $õßŞÓşş->end(); if ($ÏİóÕÛ > $ıšÏ¸«À) { $ıšÏ¸«À = $ÏİóÕÛ; } $“»øª ï = array($áÇ¦ì‘¶[843] => $¡Í›™Ë™, $áÇ¦ì‘¶[839] => 1, $áÇ¦ì‘¶[856] => $ıšÏ¸«À, $áÇ¦ì‘¶[857] => $ÏİóÕÛ, $áÇ¦ì‘¶[858] => time()); Backup::set($“»øª ï); if ($ıšÏ¸«À - $ÏİóÕÛ > 0) { $«­‡ıºç = $áÇ¦ì‘¶[859]; if (!stristr(I18n::getType(), $áÇ¦ì‘¶[860])) { $«­‡ıºç = $áÇ¦ì‘¶[861]; } write_log(array($«­‡ıºç, $“»øª ï), $áÇ¦ì‘¶[849]); return !1; } return !0; } private function tmpFilesPath() { $ÑÖ§èÌ =& $_SERVER[ÆªÈ–¬]; $¨»–öÇÑ = TEMP_FILES; if ($GLOBALS[$ÑÖ§èÌ[6]][$ÑÖ§èÌ[92]][$ÑÖ§èÌ[862]]) { $¨»–öÇÑ = $GLOBALS[$ÑÖ§èÌ[6]][$ÑÖ§èÌ[92]][$ÑÖ§èÌ[862]]; if (!mk_dir($¨»–öÇÑ) || !is_writable($¨»–öÇÑ) || !IO::mkfile($¨»–öÇÑ . $ÑÖ§èÌ[863])) { $¨»–öÇÑ = TEMP_FILES; } } return $¨»–öÇÑ; } } class BackupDbFile { public function __construct() { } public function index() { $™ü‰È¶ù =& $_SERVER[ÆªÈ–¬]; $Ì¼ª¸«® = Backup::get(); $ã¶âÒ¢Ò = $Ì¼ª¸«®[$™ü‰È¶ù[32]]; $¨Œœà¡² = $this->tmpFilesPath() . "\142\141\x63\x6b\165\x70\x5f{$ã¶âÒ¢Ò}\x2f"; $»ıË™Ø£ = $this->backupPath($Ì¼ª¸«®); if (!($»ıË™Ø£ = IO::mkdir($»ıË™Ø£))) { return !1; } $Š‰™”çÚ = IO::listPath($¨Œœà¡²); $Ã†¾ùõ¼ = isset($Š‰™”çÚ[$™ü‰È¶ù[86]]) ? $Š‰™”çÚ[$™ü‰È¶ù[86]] : array(); $Œ¿é¡½— = array_sum(array_column($Ã†¾ùõ¼, $™ü‰È¶ù[79])); if (!$Œ¿é¡½—) { return !1; } $¡½³ê®é = array($™ü‰È¶ù[864] => $Œ¿é¡½—, $™ü‰È¶ù[865] => time()); Backup::set($¡½³ê®é); $‹‘Ì¾ã = new TaskFileTransfer($™ü‰È¶ù[866], $™ü‰È¶ù[849], count($Ã†¾ùõ¼), LNG($™ü‰È¶ù[850]) . $™ü‰È¶ù[462] . LNG($™ü‰È¶ù[852]) . $™ü‰È¶ù[867]); $‹‘Ì¾ã->task[$™ü‰È¶ù[829]] = $Œ¿é¡½—; foreach ($Š‰™”çÚ[$™ü‰È¶ù[86]] as $¿ĞœËá©) { $øÕíÆŒ³ = IO::move($¿ĞœËá©[$™ü‰È¶ù[87]], $»ıË™Ø£); if (!$øÕíÆŒ³) { $‹‘Ì¾ã->end(); $¡Øñå»— = IO::getLastError($™ü‰È¶ù[868] . $¿ĞœËá©[$™ü‰È¶ù[87]] . $™ü‰È¶ù[869] . $»ıË™Ø£ . $™ü‰È¶ù[178]); write_log($¡Øñå»—, $™ü‰È¶ù[849]); return !1; } } $â¯¯¥ÔÃ = new DbManage(); $ÆëçÎ†÷ = $â¯¯¥ÔÃ->getSqlFile(); if (!$ÆëçÎ†÷[$™ü‰È¶ù[870]] || !$ÆëçÎ†÷[$™ü‰È¶ù[13]]) { return !1; } IO::move($ÆëçÎ†÷[$™ü‰È¶ù[870]], $»ıË™Ø£); IO::move($ÆëçÎ†÷[$™ü‰È¶ù[13]], $»ıË™Ø£); $‹‘Ì¾ã->end(); $¡½³ê®é = array($™ü‰È¶ù[871] => $Œ¿é¡½—, $™ü‰È¶ù[872] => time()); Backup::set($¡½³ê®é); return !0; } private function backupPath($œä¹‚É–) { $š£€¸›× =& $_SERVER[ÆªÈ–¬]; $˜áÁ°Ÿé = $œä¹‚É–[$š£€¸›×[32]]; $Õúò™ïì = Model($š£€¸›×[836])->get($š£€¸›×[837]); $Ñß§¦ê¤ = substr(md5($š£€¸›×[838] . $Õúò™ïì . $˜áÁ°Ÿé), 0, 8); return "\x7b\151\157\72{$œä¹‚É–[$š£€¸›×[818]]}\x7d\57\144\141\164\x61\x62\x61\163\x65\x2f\142\141\143\153\165\x70\57" . $˜áÁ°Ÿé . $š£€¸›×[11] . $Ñß§¦ê¤; } private function tmpFilesPath() { $ˆßÏ„˜‹ =& $_SERVER[ÆªÈ–¬]; $Î“½µ‘ö = TEMP_FILES; if ($GLOBALS[$ˆßÏ„˜‹[6]][$ˆßÏ„˜‹[92]][$ˆßÏ„˜‹[862]]) { $Î“½µ‘ö = $GLOBALS[$ˆßÏ„˜‹[6]][$ˆßÏ„˜‹[92]][$ˆßÏ„˜‹[862]]; if (!mk_dir($Î“½µ‘ö) || !is_writable($Î“½µ‘ö) || !IO::mkfile($Î“½µ‘ö . $ˆßÏ„˜‹[863])) { $Î“½µ‘ö = TEMP_FILES; } } return $Î“½µ‘ö; } } class BackupFile { public function __construct() { } public function index() { $‹°Œå† = Backup::get(); $¡‰„¿Æİ = $‹°Œå†[$_SERVER[ÆªÈ–¬][369]][$_SERVER[ÆªÈ–¬][230]][$_SERVER[ÆªÈ–¬][541]]; $˜¥¡×õ¸ = array($_SERVER[ÆªÈ–¬][542] => array($_SERVER[ÆªÈ–¬][873], $¡‰„¿Æİ), $_SERVER[ÆªÈ–¬][874] => array($_SERVER[ÆªÈ–¬][407], $‹°Œå†[$_SERVER[ÆªÈ–¬][818]])); $†¥öİçó = (int) Model($_SERVER[ÆªÈ–¬][855])->where($˜¥¡×õ¸)->count($_SERVER[ÆªÈ–¬][541]); $¾®ÔÑŸ = (int) Model($_SERVER[ÆªÈ–¬][855])->where($˜¥¡×õ¸)->sum($_SERVER[ÆªÈ–¬][79]); $œ†”µÑç = new TaskFileTransfer($_SERVER[ÆªÈ–¬][875], $_SERVER[ÆªÈ–¬][849], $†¥öİçó, LNG($_SERVER[ÆªÈ–¬][850]) . $_SERVER[ÆªÈ–¬][851] . LNG($_SERVER[ÆªÈ–¬][876])); $œ†”µÑç->task[$_SERVER[ÆªÈ–¬][829]] = $¾®ÔÑŸ; $·‡ÅÈÒé = array($_SERVER[ÆªÈ–¬][877] => $†¥öİçó, $_SERVER[ÆªÈ–¬][878] => $¾®ÔÑŸ, $_SERVER[ÆªÈ–¬][879] => time()); Backup::set($·‡ÅÈÒé); $¿í¡şûË = !0; $ÔÈ‹ÑÂÓ = $this->storeIds(); $¿ŠøÁû½ = 1; $ÔŠ‹ĞŸú = 1000; $¥ßíûö = $”¯ÆÅß = 0; $ÏşçÀØ = array(); $›äƒËœ§ = $ÆáÈœêÈ = 0; do { $”Ù½£Õ” = $_SERVER[ÆªÈ–¬][880]; $›¥»Õ·Ï = Model($_SERVER[ÆªÈ–¬][855])->where($˜¥¡×õ¸)->field($”Ù½£Õ”)->order($_SERVER[ÆªÈ–¬][881])->selectPage($ÔŠ‹ĞŸú, $¿ŠøÁû½); $É­±ù² = !empty($›¥»Õ·Ï[$_SERVER[ÆªÈ–¬][445]]) ? $›¥»Õ·Ï[$_SERVER[ÆªÈ–¬][445]] : array(); foreach ($É­±ù² as $ğ«ïö™Å) { if (!$this->_fileExist($ğ«ïö™Å, $ÏşçÀØ, $ÔÈ‹ÑÂÓ)) { write_log("\x66\x69\154\x65\40\156\157\164\40\x65\170\151\163\164\56\x66\151\x6c\x65\111\104\x3a{$ğ«ïö™Å[$_SERVER[ÆªÈ–¬][541]]}\x2c\x20\160\x61\x74\x68\x3a{$ğ«ïö™Å[$_SERVER[ÆªÈ–¬][87]]}", $_SERVER[ÆªÈ–¬][882]); continue; } $†ùÚû = $ğ«ïö™Å[$_SERVER[ÆªÈ–¬][87]]; $Á‘Ÿ” = "\x7b\151\157\72{$‹°Œå†[$_SERVER[ÆªÈ–¬][818]]}\175" . substr($†ùÚû, strlen("\173\151\157\72{$ğ«ïö™Å[$_SERVER[ÆªÈ–¬][883]]}\x7d")); if (IO::exist($Á‘Ÿ”)) { $œ†”µÑç->updateFileEnd($ğ«ïö™Å[$_SERVER[ÆªÈ–¬][32]], $ğ«ïö™Å[$_SERVER[ÆªÈ–¬][79]]); } else { $Á‘Ÿ” = get_path_father($Á‘Ÿ”); IO::mkdir($Á‘Ÿ”); if (!IO::copy($†ùÚû, $Á‘Ÿ”, $_SERVER[ÆªÈ–¬][884])) { write_log($_SERVER[ÆªÈ–¬][885] . $†ùÚû . $_SERVER[ÆªÈ–¬][869] . $Á‘Ÿ” . $_SERVER[ÆªÈ–¬][178], $_SERVER[ÆªÈ–¬][849]); $¿í¡şûË = !1; break; } } $¡‰„¿Æİ = $ğ«ïö™Å[$_SERVER[ÆªÈ–¬][541]]; $”¯ÆÅß += 1; $¥ßíûö += $ğ«ïö™Å[$_SERVER[ÆªÈ–¬][79]]; $ÆáÈœêÈ += 1; $›äƒËœ§ += $ğ«ïö™Å[$_SERVER[ÆªÈ–¬][79]]; if ($¥ßíûö >= 1024 * 1024 * 100) { $·‡ÅÈÒé = array($_SERVER[ÆªÈ–¬][817] => $¡‰„¿Æİ, $_SERVER[ÆªÈ–¬][886] => $ÆáÈœêÈ, $_SERVER[ÆªÈ–¬][887] => $›äƒËœ§); Backup::set($·‡ÅÈÒé); $¥ßíûö = $”¯ÆÅß = 0; } } $ÔêÍëÂ = count($É­±ù²); $¿ŠøÁû½++; } while ($ÔêÍëÂ == $ÔŠ‹ĞŸú); $œ†”µÑç->end(); $·‡ÅÈÒé = array($_SERVER[ÆªÈ–¬][888] => 1, $_SERVER[ÆªÈ–¬][827] => time(), $_SERVER[ÆªÈ–¬][841] => 1, $_SERVER[ÆªÈ–¬][817] => $¡‰„¿Æİ, $_SERVER[ÆªÈ–¬][889] => time()); if ($”¯ÆÅß) { $·‡ÅÈÒé[$_SERVER[ÆªÈ–¬][886]] = $ÆáÈœêÈ; $·‡ÅÈÒé[$_SERVER[ÆªÈ–¬][887]] = $›äƒËœ§; } Backup::set($·‡ÅÈÒé); return !0; } private function _fileExist($áàİ²÷é, &$“ü“ôşä, $¢ˆİÍ½ì) { $Ú€–ƒ–Ñ =& $_SERVER[ÆªÈ–¬]; $“º³¼Šò = $áàİ²÷é[$Ú€–ƒ–Ñ[87]]; if (in_array($áàİ²÷é[$Ú€–ƒ–Ñ[541]], $“ü“ôşä)) { return !1; } if (!in_array($áàİ²÷é[$Ú€–ƒ–Ñ[883]], $¢ˆİÍ½ì)) { return !1; } if (IO::exist($“º³¼Šò)) { return !0; } $½–…ÚÄ = get_path_father($“º³¼Šò); if (IO::exist($½–…ÚÄ)) { $“ü“ôşä[] = $áàİ²÷é[$Ú€–ƒ–Ñ[541]]; return !1; } $¡à­İ²Á = array($Ú€–ƒ–Ñ[883] => $áàİ²÷é[$Ú€–ƒ–Ñ[883]], $Ú€–ƒ–Ñ[87] => array($Ú€–ƒ–Ñ[459], "{$½–…ÚÄ}\45")); $Œµá—¶ƒ = Model($Ú€–ƒ–Ñ[855])->where($¡à­İ²Á)->field($Ú€–ƒ–Ñ[542])->select(); $“ü“ôşä = array_merge($“ü“ôşä, array_to_keyvalue($Œµá—¶ƒ, $Ú€–ƒ–Ñ[12], $Ú€–ƒ–Ñ[541])); return !1; } private function _fileFilter($³ãöÚ…) { $âƒôö• =& $_SERVER[ÆªÈ–¬]; return; if (empty($³ãöÚ…)) { return; } $şÔµÊ«¬ = array($âƒôö•[541] => array($âƒôö•[7], array_unique($³ãöÚ…))); $„à›¶— = Model($âƒôö•[890])->where($şÔµÊ«¬)->field($âƒôö•[193])->select(); foreach ($„à›¶— as $Ğòâı¬) { Model($âƒôö•[890])->remove($Ğòâı¬[$âƒôö•[193]], !1); } } private function storeIds() { $ı©ıĞ‹Ğ =& $_SERVER[ÆªÈ–¬]; $Ÿåß×ª­ = Model($ı©ıĞ‹Ğ[833])->listData(); $äİÁÍØ« = array(); $šà¥³Áã = $GLOBALS[$ı©ıĞ‹Ğ[6]][$ı©ıĞ‹Ğ[92]][$ı©ıĞ‹Ğ[891]]; foreach ($Ÿåß×ª­ as $çÈÌš) { $–©€¼øß = strtolower($çÈÌš[$ı©ıĞ‹Ğ[98]]); if (!isset($šà¥³Áã[$–©€¼øß])) { continue; } $‚“èÉÓ = $ı©ıĞ‹Ğ[77] . (isset($šà¥³Áã[$–©€¼øß]) ? $šà¥³Áã[$–©€¼øß] : ucfirst($–©€¼øß)); if (!class_exists($‚“èÉÓ)) { continue; } $äİÁÍØ«[] = $çÈÌš[$ı©ıĞ‹Ğ[475]]; } return $äİÁÍØ«; } } goto B‡¤ÕµâÂ; dÑÁØÓÂ”î: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¶ïªøù =& $_SERVER[ÆªÈ–¬]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¶ïªøù[6]] =& $config; $this->values[$¶ïªøù[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¶ïªøù[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($õœ“²ıî) { if (1 === func_num_args()) { $this->{$õœ“²ıî} = new $õœ“²ıî(); } else { $Ç¾çµ„¹ = new ReflectionClass($õœ“²ıî); $»ôÀıà× = func_get_args(); array_shift($»ôÀıà×); $this->{$õœ“²ıî} = $Ç¾çµ„¹->newInstanceArgs($»ôÀıà×); } return $this->{$õœ“²ıî}; } public function routeBind($ Şø¾¢·, $–Ô¯ú¬, $¼·ö¶íà = 3) { $ò‹û½ÈÑ =& $_SERVER[ÆªÈ–¬]; $ÙüÛ§»– = $this->in[$ò‹û½ÈÑ[9]]; $ Şø¾¢· = str_replace($ò‹û½ÈÑ[10], $ò‹û½ÈÑ[11], trim(trim($ Şø¾¢·, $ò‹û½ÈÑ[8]), $ò‹û½ÈÑ[12])); if (!$ Şø¾¢· || count($ÙüÛ§»–) <= $¼·ö¶íà) { return !1; } $¯ı‡ì¸ = !0; $ğÉÙµì = explode($ò‹û½ÈÑ[8], $ Şø¾¢·); for ($²ÎÓ±Ë = 0; $²ÎÓ±Ë < count($ğÉÙµì); $²ÎÓ±Ë++) { if ($ğÉÙµì[$²ÎÓ±Ë] != $ÙüÛ§»–[$¼·ö¶íà + $²ÎÓ±Ë]) { $¯ı‡ì¸ = !1; break; } } if (!$¯ı‡ì¸) { return; } call_user_func_array(array($this, $–Ô¯ú¬), array()); } public function routeArgs($óÌÀœ = 3) { $ñæ‰„éé = $this->in[$_SERVER[ÆªÈ–¬][9]]; if (count($ñæ‰„éé) <= $óÌÀœ) { return array(); } $ƒ›ö–Õ¼ = array(); for ($‡Ò‰‡ñû = $óÌÀœ; $‡Ò‰‡ñû < count($ñæ‰„éé); $‡Ò‰‡ñû += 2) { $ƒ›ö–Õ¼[$ñæ‰„éé[$‡Ò‰‡ñû]] = $ñæ‰„éé[$‡Ò‰‡ñû + 1]; $this->in[$ñæ‰„éé[$‡Ò‰‡ñû]] = $ñæ‰„éé[$‡Ò‰‡ñû + 1]; } return $ƒ›ö–Õ¼; } protected function assign($×Õ¢µ‰–, $ œèü‚) { $this->values[$×Õ¢µ‰–] = $ œèü‚; } protected function display($¼Ş÷·Õ÷) { ob_end_clean(); extract($this->values); require $this->tpl . $¼Ş÷·Õ÷; } } class DbSqliteBase extends Db { public function __construct($í‘«‚’Á = '') { $±¦ Ø€® =& $_SERVER[ÆªÈ–¬]; if (!extension_loaded($±¦ Ø€®[13])) { think_exception(think_lang($±¦ Ø€®[14]) . $±¦ Ø€®[15]); } if (!empty($í‘«‚’Á)) { if (!isset($í‘«‚’Á[$±¦ Ø€®[16]])) { $í‘«‚’Á[$±¦ Ø€®[16]] = 438; } $this->config = $í‘«‚’Á; if (empty($this->config[$±¦ Ø€®[17]])) { $this->config[$±¦ Ø€®[17]] = array(); } } } public function connect($ş€ıƒì = '', $€ÛŒÄº¿ = 0) { $ÉÀˆ£ª =& $_SERVER[ÆªÈ–¬]; if (!isset($this->linkID[$€ÛŒÄº¿])) { if (empty($ş€ıƒì)) { $ş€ıƒì = $this->config; } $ßïô¯¾„ = !empty($ş€ıƒì[$ÉÀˆ£ª[17]][$ÉÀˆ£ª[18]]) ? $ş€ıƒì[$ÉÀˆ£ª[17]][$ÉÀˆ£ª[18]] : $this->pconnect; $ÑÔË“õ = $ßïô¯¾„ ? $ÉÀˆ£ª[19] : $ÉÀˆ£ª[20]; $this->linkID[$€ÛŒÄº¿] = $ÑÔË“õ($ş€ıƒì[$ÉÀˆ£ª[21]], $ş€ıƒì[$ÉÀˆ£ª[16]]); if (!$this->linkID[$€ÛŒÄº¿]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$€ÛŒÄº¿], 30000); if (1 != think_config($ÉÀˆ£ª[22])) { unset($this->config); } } return $this->linkID[$€ÛŒÄº¿]; } public function free() { $this->queryID = null; } public function query($¹Ìù¸µ­) { $­Â˜¼™ =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¹Ìù¸µ­; if ($this->queryID) { $this->free(); } think_action_status($­Â˜¼™[23], 1); think_status($­Â˜¼™[24]); $this->queryID = sqlite_query($this->_linkID, $¹Ìù¸µ­); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $£˜ó‹´ê = $this->getAll(); return $£˜ó‹´ê; } } public function execute($½ˆçÒş”) { $¶ã¾œ =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $½ˆçÒş”; if ($this->queryID) { $this->free(); } think_action_status($¶ã¾œ[25], 1); think_status($¶ã¾œ[24]); $Æ´ ç®ò = sqlite_exec($this->_linkID, $½ˆçÒş”); $this->debug(); if (!1 === $Æ´ ç®ò) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÆªÈ–¬][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¢ƒ°ğë† = sqlite_query($this->_linkID, $_SERVER[ÆªÈ–¬][27]); if (!$¢ƒ°ğë†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÉÃ®Ğ‡ = sqlite_query($this->_linkID, $_SERVER[ÆªÈ–¬][28]); if (!$ÉÃ®Ğ‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $èÄÏ§êÎ = array(); if ($this->numRows > 0) { for ($¡‚—âú‹ = 0; $¡‚—âú‹ < $this->numRows; $¡‚—âú‹++) { $èÄÏ§êÎ[$¡‚—âú‹] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $èÄÏ§êÎ; } public function getFields($åùŠÃ«) { $í¨ÆŸ¿Í =& $_SERVER[ÆªÈ–¬]; $Ï£á¹–ü = $this->query($í¨ÆŸ¿Í[29] . $åùŠÃ« . $í¨ÆŸ¿Í[30]); $¾ßÎí½“ = array(); if ($Ï£á¹–ü) { foreach ($Ï£á¹–ü as $ÑÕ†¡Ÿ¨ => $İø–‹Ô‘) { $¾ßÎí½“[$İø–‹Ô‘[$í¨ÆŸ¿Í[31]]] = array($í¨ÆŸ¿Í[32] => $İø–‹Ô‘[$í¨ÆŸ¿Í[31]], $í¨ÆŸ¿Í[33] => $İø–‹Ô‘[$í¨ÆŸ¿Í[34]], $í¨ÆŸ¿Í[35] => (bool) ($İø–‹Ô‘[$í¨ÆŸ¿Í[36]] === $í¨ÆŸ¿Í[12]), $í¨ÆŸ¿Í[37] => $İø–‹Ô‘[$í¨ÆŸ¿Í[38]], $í¨ÆŸ¿Í[39] => strtolower($İø–‹Ô‘[$í¨ÆŸ¿Í[40]]) == $í¨ÆŸ¿Í[41], $í¨ÆŸ¿Í[42] => strtolower($İø–‹Ô‘[$í¨ÆŸ¿Í[43]]) == $í¨ÆŸ¿Í[44]); } } return $¾ßÎí½“; } public function getTables($ôõ™­§ã = '') { $İ¡Áçî =& $_SERVER[ÆªÈ–¬]; $³ì×È…ø = $this->query($İ¡Áçî[45] . $İ¡Áçî[46] . $İ¡Áçî[47]); $‚››ØŠŠ = array(); foreach ($³ì×È…ø as $±ï’‹” => $—ó±ìü ) { $‚››ØŠŠ[$±ï’‹”] = current($—ó±ìü ); } return $‚››ØŠŠ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $”ò¯×Ù =& $_SERVER[ÆªÈ–¬]; $…š¤õÀ” = sqlite_last_error($this->_linkID); $this->error = $…š¤õÀ” . $”ò¯×Ù[4] . sqlite_error_string($…š¤õÀ”); if ($”ò¯×Ù[12] != $this->queryStr) { $this->error .= LNG($”ò¯×Ù[48]) . $this->queryStr; } think_trace($this->error, $”ò¯×Ù[12], $”ò¯×Ù[49]); return $this->error; } public function escapeString($ûÔÚ¶İÂ) { return sqlite_escape_string($ûÔÚ¶İÂ); } public function parseLimit($“¯Ÿ½½ë) { $Û‰¡Ö© =& $_SERVER[ÆªÈ–¬]; $´éüåª  = $Û‰¡Ö©[12]; if (!empty($“¯Ÿ½½ë)) { $“¯Ÿ½½ë = explode($Û‰¡Ö©[50], $“¯Ÿ½½ë); if (count($“¯Ÿ½½ë) > 1) { $´éüåª  .= $Û‰¡Ö©[51] . $“¯Ÿ½½ë[1] . $Û‰¡Ö©[52] . $“¯Ÿ½½ë[0] . $Û‰¡Ö©[53]; } else { $´éüåª  .= $Û‰¡Ö©[51] . $“¯Ÿ½½ë[0] . $Û‰¡Ö©[53]; } } return $´éüåª ; } } class DbSqlite3Base extends Db { public function __construct($›¡óµË = '') { $ªÄÌ¦Ì× =& $_SERVER[ÆªÈ–¬]; if (!class_exists($ªÄÌ¦Ì×[54])) { think_exception(think_lang($ªÄÌ¦Ì×[14]) . $ªÄÌ¦Ì×[55]); } if (!empty($›¡óµË)) { if (!isset($›¡óµË[$ªÄÌ¦Ì×[16]])) { $›¡óµË[$ªÄÌ¦Ì×[16]] = 438; } $this->config = $›¡óµË; if (empty($this->config[$ªÄÌ¦Ì×[17]])) { $this->config[$ªÄÌ¦Ì×[17]] = array(); } } } public function connect($„ÏÓñÛ = '', $±ÍéÙÁ = 0) { $éù‰” =& $_SERVER[ÆªÈ–¬]; if (!isset($this->linkID[$±ÍéÙÁ])) { if (empty($„ÏÓñÛ)) { $„ÏÓñÛ = $this->config; } $this->linkID[$±ÍéÙÁ] = new SQLite3($„ÏÓñÛ[$éù‰”[21]]); if (!$this->linkID[$±ÍéÙÁ]) { think_exception($this->linkID[$±ÍéÙÁ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$±ÍéÙÁ]->busyTimeout(30000); if (1 != think_config($éù‰”[22])) { unset($this->config); } } return $this->linkID[$±ÍéÙÁ]; } public function free() { $this->queryID = null; } public function query($— ôê³Õ) { $îë«¾ =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $— ôê³Õ; if ($this->queryID) { $this->free(); } think_action_status($îë«¾[23], 1); think_status($îë«¾[24]); $this->queryID = $this->_linkID->query($— ôê³Õ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $·›·ˆ´” = $this->getAll(); $this->numRows = count($·›·ˆ´”); return $·›·ˆ´”; } } public function execute($Ò¢«Òñœ) { $øŸ®ç¹† =& $_SERVER[ÆªÈ–¬]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò¢«Òñœ; if ($this->queryID) { $this->free(); } think_action_status($øŸ®ç¹†[25], 1); think_status($øŸ®ç¹†[24]); $Ñ±›àœÂ = $this->_linkID->exec($Ò¢«Òñœ); $this->debug(); if (!1 === $Ñ±›àœÂ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÆªÈ–¬][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ö²´‰ = $this->_linkID->query($_SERVER[ÆªÈ–¬][27]); if (!$Ö²´‰) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $·´ÊæĞ¬ = $this->_linkID->query($_SERVER[ÆªÈ–¬][28]); if (!$·´ÊæĞ¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $îÆÃÃó = array(); while ($¬‘Ôİï¹ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $îÆÃÃó[] = $¬‘Ôİï¹; } $this->queryID->reset(); return $îÆÃÃó; } public function getFields($§ÊÏ‚½®) { $Üß–çÃº =& $_SERVER[ÆªÈ–¬]; $ì«”ïŸ = $this->query($Üß–çÃº[29] . $§ÊÏ‚½® . $Üß–çÃº[30]); $˜üÏãÊ« = array(); if ($ì«”ïŸ) { foreach ($ì«”ïŸ as $Õè­Ñè÷ => $ƒâ›ÏÙº) { $˜üÏãÊ«[$ƒâ›ÏÙº[$Üß–çÃº[32]]] = array($Üß–çÃº[32] => $ƒâ›ÏÙº[$Üß–çÃº[32]], $Üß–çÃº[33] => $ƒâ›ÏÙº[$Üß–çÃº[33]], $Üß–çÃº[35] => (bool) ($ƒâ›ÏÙº[$Üß–çÃº[35]] === $Üß–çÃº[12]), $Üß–çÃº[37] => $ƒâ›ÏÙº[$Üß–çÃº[56]], $Üß–çÃº[39] => (bool) $ƒâ›ÏÙº[$Üß–çÃº[57]], $Üß–çÃº[42] => (bool) $ƒâ›ÏÙº[$Üß–çÃº[57]]); } } return $˜üÏãÊ«; } public function getTables($Ã´¥ùˆ = '') { $”ˆ‹ÀÔâ =& $_SERVER[ÆªÈ–¬]; $ÜàÁ± = $this->query($”ˆ‹ÀÔâ[45] . $”ˆ‹ÀÔâ[46] . $”ˆ‹ÀÔâ[47]); $ÁÔ§Ÿ¾è = array(); foreach ($ÜàÁ± as $Á¬¢·¾‰ => $É×ãàÅÖ) { $ÁÔ§Ÿ¾è[$Á¬¢·¾‰] = current($É×ãàÅÖ); } return $ÁÔ§Ÿ¾è; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $í¦ÄÖßâ =& $_SERVER[ÆªÈ–¬]; $this->error = $this->_linkID->lastErrorMsg(); if ($í¦ÄÖßâ[12] != $this->queryStr) { $this->error .= LNG($í¦ÄÖßâ[48]) . $this->queryStr; } think_trace($this->error, $í¦ÄÖßâ[12], $í¦ÄÖßâ[49]); return $this->error; } public function escapeString($Œï‰Ö®î) { $ßõûè£ó =& $_SERVER[ÆªÈ–¬]; if ($this->_linkID) { return $this->_linkID->escapeString($Œï‰Ö®î); } return str_ireplace($ßõûè£ó[58], $ßõûè£ó[59], $Œï‰Ö®î); } public function parseLimit($¿—¦´Á) { $ˆÁãñáİ =& $_SERVER[ÆªÈ–¬]; $¸¶–‚¦Í = $ˆÁãñáİ[12]; if (!empty($¿—¦´Á)) { $¿—¦´Á = explode($ˆÁãñáİ[50], $¿—¦´Á); if (count($¿—¦´Á) > 1) { $¸¶–‚¦Í .= $ˆÁãñáİ[51] . $¿—¦´Á[1] . $ˆÁãñáİ[52] . $¿—¦´Á[0] . $ˆÁãñáİ[53]; } else { $¸¶–‚¦Í .= $ˆÁãñáİ[51] . $¿—¦´Á[0] . $ˆÁãñáİ[53]; } } return $¸¶–‚¦Í; } } goto eíêŠÌÀÄ…; b°¥Æè•á: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x70\154\x75\x67\151\x6e\114\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x73\x74\x61\x74\x75\x73", "\162\x65\147\151\145\x73\x74", "\143\x6f\x6e\146\x69\147"); public function loadList($îëÑÓ”â = false) { $‘ø¾»»Ê = array_to_keyvalue($this->listData(), $_SERVER[ÆªÈ–¬][32]); if ($îëÑÓ”â) { return $‘ø¾»»Ê[$îëÑÓ”â]; } return $‘ø¾»»Ê; } public function init() { $‰Ë—•µ‹ =& $_SERVER[ÆªÈ–¬]; Hook::trigger($‰Ë—•µ‹[2088]); $ëŞñÃ×ë = $this->loadPluginList(); foreach ($ëŞñÃ×ë as $‚€“°çâ => $ò¨…–é‹) { $Ùšë¾™µ = $this->appAllow($‚€“°çâ, $ò¨…–é‹); if (!$Ùšë¾™µ) { continue; } foreach ($ò¨…–é‹[$‰Ë—•µ‹[2089]] as $€ Ú¼Æ => $Ü™ÙÓ×Ô) { Hook::bind($€ Ú¼Æ, $Ü™ÙÓ×Ô); } } Hook::trigger($‰Ë—•µ‹[2090]); Hook::trigger(ACTION); } public function appAllow($ ç¶ƒòë, $ƒèï÷ÚÀ, $á©˜È‡ì = true) { $øö›ÕÛ =& $_SERVER[ÆªÈ–¬]; $—…Ô—Ş = PLUGIN_DIR . $ ç¶ƒòë . $øö›ÕÛ[2091]; if (!is_array($ƒèï÷ÚÀ) || !is_array($ƒèï÷ÚÀ[$øö›ÕÛ[2089]]) || $ƒèï÷ÚÀ[$øö›ÕÛ[816]] != 1 || !is_file($—…Ô—Ş)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$øö›ÕÛ[6]][$øö›ÕÛ[2092]] || !$GLOBALS[$øö›ÕÛ[6]][$øö›ÕÛ[2093]]) { return !0; } $¤¹ı … = explode($øö›ÕÛ[50], strtolower($GLOBALS[$øö›ÕÛ[6]][$øö›ÕÛ[2093]])); return in_array(strtolower($ ç¶ƒòë), $¤¹ı …) ? !1 : !0; } if ($á©˜È‡ì && !Action($øö›ÕÛ[2094])->checkAuth($ ç¶ƒòë)) { return !1; } return !0; } public function unInstall($ê ıŠğ‘) { $‹Ïí¡ˆä =& $_SERVER[ÆªÈ–¬]; $úƒŸüÆÄ = $this->loadList($ê ıŠğ‘); if (file_exists(PLUGIN_DIR . $ê ıŠğ‘)) { Hook::apply($ê ıŠğ‘ . $‹Ïí¡ˆä[2095]); } $this->remove($úƒŸüÆÄ[$‹Ïí¡ˆä[475]]); } public function changeStatus($•îÎÓÍ, $÷«ˆŞæ) { $—Øê¯Ù¸ =& $_SERVER[ÆªÈ–¬]; $õÇñéóù = $this->loadList($•îÎÓÍ); if ($÷«ˆŞæ) { Hook::apply($•îÎÓÍ . $—Øê¯Ù¸[2096]); } $this->update($õÇñéóù[$—Øê¯Ù¸[475]], array($—Øê¯Ù¸[2097] => $÷«ˆŞæ)); } public function appRegist($ªóÕÖÚ´, $€¶Üëå) { $¡ñĞ”¢° =& $_SERVER[ÆªÈ–¬]; $¯®¡ë = $this->loadList($ªóÕÖÚ´); if ($¯®¡ë) { $this->update($¯®¡ë[$¡ñĞ”¢°[475]], array($¡ñĞ”¢°[2089] => $€¶Üëå)); } else { $øÈÀò¬Œ = array($¡ñĞ”¢°[32] => $ªóÕÖÚ´, $¡ñĞ”¢°[2089] => $€¶Üëå, $¡ñĞ”¢°[816] => 0, $¡ñĞ”¢°[6] => $this->getConfigDefault($ªóÕÖÚ´)); $this->insert($øÈÀò¬Œ); } } public function getConfigDefault($²á©òó) { $½§–š»Ã =& $_SERVER[ÆªÈ–¬]; $ªïøà¡ = array(); $µ’Ã¸ = $this->getPackageJson($²á©òó); if (!$µ’Ã¸ && is_array($µ’Ã¸[$½§–š»Ã[2098]])) { return $ªïøà¡; } foreach ($µ’Ã¸[$½§–š»Ã[2098]] as $ñî¥ò»Š => $ñæåÜğ) { if (!isset($ñæåÜğ[$½§–š»Ã[450]]) || isset($ªïøà¡[$ñî¥ò»Š])) { continue; } $ªïøà¡[$ñî¥ò»Š] = $ñæåÜğ[$½§–š»Ã[450]]; } return $ªïøà¡; } public function getPackageJson($Ûº’ÇÈƒ) { return Hook::apply($Ûº’ÇÈƒ . $_SERVER[ÆªÈ–¬][2099]); } public function getConfig($Ö‘±Ê•·, $°³ÕÏî½ = false) { $úú‘Ìú =& $_SERVER[ÆªÈ–¬]; $èæáÇ  = array(); $¢´©™òã = $this->loadList($Ö‘±Ê•·); if ($¢´©™òã && is_array($¢´©™òã[$úú‘Ìú[6]])) { $èæáÇ  = $¢´©™òã[$úú‘Ìú[6]]; } if (!$èæáÇ  || $°³ÕÏî½) { $èæáÇ  = $this->getConfigDefault($Ö‘±Ê•·); } return $èæáÇ ; } public function setConfig($œéŸºŸŠ, $†âÊ–œ¯ = false) { $¼Ñ½ÛæÙ =& $_SERVER[ÆªÈ–¬]; $¸Î¦‹…¡ = $this->loadList($œéŸºŸŠ); if (!$¸Î¦‹…¡) { return !1; } $ÌËŒ¼å÷ = $¸Î¦‹…¡[$¼Ñ½ÛæÙ[6]]; if ($†âÊ–œ¯ == !1) { $ÌËŒ¼å÷ = array(); $†âÊ–œ¯ = $this->getConfigDefault($œéŸºŸŠ); } foreach ($†âÊ–œ¯ as $ëÛÒàĞÅ => $Í›®²±¢) { $ÌËŒ¼å÷[$ëÛÒàĞÅ] = is_string($Í›®²±¢) ? trim($Í›®²±¢) : $Í›®²±¢; } $this->update($¸Î¦‹…¡[$¼Ñ½ÛæÙ[475]], array($¼Ñ½ÛæÙ[6] => $ÌËŒ¼å÷)); } public function viewList() { $î­Ù§ì¦ =& $_SERVER[ÆªÈ–¬]; $Ñô‚Üîµ = $this->loadList(); $this->pluginScan($Ñô‚Üîµ); $Ñô‚Üîµ = $this->loadPluginList(); $¿é§ï³Ã = array(); foreach ($Ñô‚Üîµ as $€‡›ñšƒ => $Ú¦²ş·½) { $õêÁ‘ş„ = $Ú¦²ş·½; unset($Ú¦²ş·½[$î­Ù§ì¦[2089]], $Ú¦²ş·½[$î­Ù§ì¦[6]]); $ÌÔ°Æ„½ = PLUGIN_DIR . $Ú¦²ş·½[$î­Ù§ì¦[32]] . $î­Ù§ì¦[2091]; if (!is_file($ÌÔ°Æ„½)) { continue; } $¥âÂâ¿ = Hook::apply($Ú¦²ş·½[$î­Ù§ì¦[32]] . $î­Ù§ì¦[2099]); if (!is_array($¥âÂâ¿)) { continue; } $¿é§ï³Ã[$€‡›ñšƒ] = array_merge($Ú¦²ş·½, $¥âÂâ¿); if ($õêÁ‘ş„[$î­Ù§ì¦[6]][$î­Ù§ì¦[1676]] != $¥âÂâ¿[$î­Ù§ì¦[1650]]) { Hook::apply($Ú¦²ş·½[$î­Ù§ì¦[32]] . $î­Ù§ì¦[2096]); $õêÁ‘ş„[$î­Ù§ì¦[6]][$î­Ù§ì¦[1676]] = $¥âÂâ¿[$î­Ù§ì¦[1650]]; $this->update($Ú¦²ş·½[$î­Ù§ì¦[475]], array($î­Ù§ì¦[6] => $õêÁ‘ş„[$î­Ù§ì¦[6]])); } } return $¿é§ï³Ã; } private function loadPluginList() { $¦îİ©®‰ =& $_SERVER[ÆªÈ–¬]; $Å™›çÌæ = $this->loadList(); if (strtolower(MOD) == $¦îİ©®‰[2100]) { return $Å™›çÌæ; } $è¢ÕÌåÑ = Hook::trigger($¦îİ©®‰[2101], $Å™›çÌæ); if ($Å™›çÌæ && !$è¢ÕÌåÑ) { die; } return $è¢ÕÌåÑ ? $è¢ÕÌåÑ : $Å™›çÌæ; } private function pluginScan($æ—ÒœŸ§) { $„êË Üé =& $_SERVER[ÆªÈ–¬]; recursion_dir(PLUGIN_DIR, $‰æØä, $òğ÷‹À², 0); foreach ($‰æØä as $„ú«”ëÈ) { $„ÛÒ­‹ö = get_path_this($„ú«”ëÈ); if (isset($æ—ÒœŸ§[$„ÛÒ­‹ö]) || !file_exists($„ú«”ëÈ . $„êË Üé[2102]) || !file_exists($„ú«”ëÈ . $„êË Üé[2091])) { continue; } Hook::apply($„ÛÒ­‹ö . $„êË Üé[2096]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\x6d\x5f\x73\x65\x73\163\x69\x6f\156"; public function get($Òûû»¢æ) { $Ü¦ÇŠ¦Á =& $_SERVER[ÆªÈ–¬]; $ã–ºÆÚ« = $this->where(array($Ü¦ÇŠ¦Á[2103] => $Òûû»¢æ))->find(); if (!is_array($ã–ºÆÚ«)) { return !1; } return $ã–ºÆÚ«[$Ü¦ÇŠ¦Á[171]]; } public function set($ĞÎº–×™, $Ÿæ¢›å€, $…¦Æ¶´ = 3600) { $±¥Û¬èâ =& $_SERVER[ÆªÈ–¬]; $óÎÒ“ºõ = array($±¥Û¬èâ[2103] => $ĞÎº–×™, $±¥Û¬èâ[2003] => $Ÿæ¢›å€, $±¥Û¬èâ[2104] => $…¦Æ¶´ + time()); if (Session::get($±¥Û¬èâ[2105])) { $óÎÒ“ºõ[$±¥Û¬èâ[1765]] = Session::get($±¥Û¬èâ[2105]); } else { $óÎÒ“ºõ[$±¥Û¬èâ[1765]] = 0; } if ($this->get($ĞÎº–×™)) { return $this->where(array($±¥Û¬èâ[2103] => $ĞÎº–×™))->save($óÎÒ“ºõ); } else { return $this->add($óÎÒ“ºõ, array(), !0); } } public function remove($ëõŸ®) { return $this->where(array($_SERVER[ÆªÈ–¬][2103] => $ëõŸ®))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÆªÈ–¬][2106] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\x65"; protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\151\x6d\x65", "\x74\151\155\x65", "\151\156\x73\145\x72\x74\54\165\160\x64\141\x74\x65", "\x66\165\156\x63\164\x69\x6f\x6e"), array("\143\x72\145\141\164\x65\x54\x69\x6d\x65", "\x74\151\155\145", "\x69\156\163\145\162\x74", "\x66\x75\156\143\164\x69\x6f\x6e"), array("\x6f\160\164\151\157\156\163", '', "\151\x6e\163\145\x72\164\x2c\165\160\144\x61\x74\x65\54\x73\x65\154\x65\x63\x74", "\152\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ãµ‡ñõ) { $Çªñòö  =& $_SERVER[ÆªÈ–¬]; $ã¬÷¿á = isset($ãµ‡ñõ[0]) ? $ãµ‡ñõ[0] : !1; return array($Çªñòö [2107] => array(USER_ID, $Çªñòö [2108]), $Çªñòö [2048] => array($ã¬÷¿á, $Çªñòö [2109])); } protected function listSimple() { $Ñ·É¯Ú = array($_SERVER[ÆªÈ–¬][1765] => USER_ID); $§ƒŒ†‘¾ = $this->field($this->fieldList)->where($Ñ·É¯Ú)->select(); return $§ƒŒ†‘¾ ? $§ƒŒ†‘¾ : array(); } protected function getInfo($Ê„½ ‘Œ, $‡ôÑ«·™ = false) { $Øü¦¨É´ =& $_SERVER[ÆªÈ–¬]; if ($‡ôÑ«·™) { return $this->_getShareInfo(array($Øü¦¨É´[665] => $Ê„½ ‘Œ)); } $æº ¾İ‡ = $this->cacheFunctionGet($Øü¦¨É´[2050], $Ê„½ ‘Œ); return $æº ¾İ‡; } public function getInfoByHash($ÄÒØ¬¹«) { return $this->_getShareInfo(array($_SERVER[ÆªÈ–¬][2110] => $ÄÒØ¬¹«)); } public function getInfoByPath($Û¹ßÓ”) { $¥ÄÇãô =& $_SERVER[ÆªÈ–¬]; $””÷ÔÀÜ = array($¥ÄÇãô[1765] => USER_ID, $¥ÄÇãô[193] => $Û¹ßÓ”); return $this->_getShareInfo($””÷ÔÀÜ); } public function getInfoBySourcePath($âıãâô) { $Ò»­¶óÀ =& $_SERVER[ÆªÈ–¬]; $áû’Õåƒ = array($Ò»­¶óÀ[1765] => USER_ID, $Ò»­¶óÀ[1250] => $âıãâô); return $this->_getShareInfo($áû’Õåƒ); } private function _getShareInfo($¤‘ŒÅıÒ) { $ÍÅÕÈç· =& $_SERVER[ÆªÈ–¬]; $³ŒÁ„øü = $this->where($¤‘ŒÅıÒ)->find(); if (!$³ŒÁ„øü) { return !1; } $¤‘ŒÅıÒ = array($ÍÅÕÈç·[665] => $³ŒÁ„øü[$ÍÅÕÈç·[665]]); $½Öêïê = $ÍÅÕÈç·[2111]; $Üèšš¯­ = Model($ÍÅÕÈç·[666])->order($ÍÅÕÈç·[475])->field($½Öêïê)->where($¤‘ŒÅıÒ)->select(); if ($³ŒÁ„øü[$ÍÅÕÈç·[193]] == $ÍÅÕÈç·[228]) { $³ŒÁ„øü[$ÍÅÕÈç·[90]] = IO::info($³ŒÁ„øü[$ÍÅÕÈç·[1250]]); } else { $³ŒÁ„øü[$ÍÅÕÈç·[90]] = Model($ÍÅÕÈç·[1411])->pathInfo($³ŒÁ„øü[$ÍÅÕÈç·[193]]); } $³ŒÁ„øü[$ÍÅÕÈç·[2112]] = $Üèšš¯­; return $³ŒÁ„øü; } protected function getInfoAuth($ÇûŞ¸ã„) { $¿ßŒ†÷œ =& $_SERVER[ÆªÈ–¬]; $“â¿øì€ = $this->getInfo($ÇûŞ¸ã„); if ($“â¿øì€[$¿ßŒ†÷œ[1765]] == USER_ID) { $“â¿øì€[$¿ßŒ†÷œ[487]] = $“â¿øì€[$¿ßŒ†÷œ[90]][$¿ßŒ†÷œ[487]]; } else { $“â¿øì€[$¿ßŒ†÷œ[487]] = Model($¿ßŒ†÷œ[567])->authMake($“â¿øì€[$¿ßŒ†÷œ[2112]]); } return $“â¿øì€; } protected function listData($î”â«¶¢ = null, $›Õßã­Ä = 300) { $æ³¤›‚ä =& $_SERVER[ÆªÈ–¬]; $Å«ËÕœ = array(array($æ³¤›‚ä[562] => array($æ³¤›‚ä[1083], 0), $æ³¤›‚ä[663] => array($æ³¤›‚ä[1083], 0), $æ³¤›‚ä[2113] => $æ³¤›‚ä[2066])); if ($î”â«¶¢ == $æ³¤›‚ä[2114]) { $Å«ËÕœ = array($æ³¤›‚ä[562] => 1); } else { if ($î”â«¶¢ == $æ³¤›‚ä[1235]) { $Å«ËÕœ = array($æ³¤›‚ä[663] => 1); } } $Å«ËÕœ[$æ³¤›‚ä[1765]] = USER_ID; $ùÓƒÂéì = $this->where($Å«ËÕœ)->selectPage($›Õßã­Ä); return $ùÓƒÂéì; } protected function listToMe($¿‹äÑ¥¬ = 300) { $²¢¨™€× =& $_SERVER[ÆªÈ–¬]; $·óèËİ« = Model($²¢¨™€×[2115])->userGroupParents(USER_ID); $Ü¶­ƒºÀ = array($²¢¨™€×[648] => SourceModel::TYPE_USER, $²¢¨™€×[569] => USER_ID); if ($·óèËİ«) { $Ü¶­ƒºÀ = array(array($²¢¨™€×[648] => SourceModel::TYPE_USER, $²¢¨™€×[569] => USER_ID), array($²¢¨™€×[648] => SourceModel::TYPE_GROUP, $²¢¨™€×[569] => array($²¢¨™€×[7], $·óèËİ«)), $²¢¨™€×[2113] => $²¢¨™€×[2066]); } $Î”Îî€Ì = Model($²¢¨™€×[666])->where($Ü¶­ƒºÀ)->selectPage($¿‹äÑ¥¬); $ê¿æ¤ú“ = array_to_keyvalue_group($Î”Îî€Ì[$²¢¨™€×[445]], $²¢¨™€×[665]); if (!$ê¿æ¤ú“) { return $Î”Îî€Ì; } $ßÔî£š— = $²¢¨™€×[2116]; $Ü¶­ƒºÀ = array($²¢¨™€×[665] => array($²¢¨™€×[492], array_keys($ê¿æ¤ú“)), $²¢¨™€×[1765] => array($²¢¨™€×[1085], $²¢¨™€×[228])); $®ÙÔ‚¼à = $this->field($ßÔî£š—)->where($Ü¶­ƒºÀ)->select(); foreach ($®ÙÔ‚¼à as $Ù¥¢ú€Ÿ => &$Ğ¤®†¤Å) { $Ğ¤®†¤Å[$²¢¨™€×[2112]] = $ê¿æ¤ú“[$Ğ¤®†¤Å[$²¢¨™€×[665]]]; } unset($Ğ¤®†¤Å); $ÚÎôçİ = array($²¢¨™€×[2117] => $®ÙÔ‚¼à, $²¢¨™€×[2118] => $Î”Îî€Ì[$²¢¨™€×[442]]); return $ÚÎôçİ; } protected function shareAdd($Š²ğ¡Û‰, $šË•èÇ) { $šÚ¯™Ÿè =& $_SERVER[ÆªÈ–¬]; $¤€ø©õï = $this->_addShareData($Š²ğ¡Û‰, $šË•èÇ); if (!empty($šË•èÇ[$šÚ¯™Ÿè[2119]])) { $this->_shareAuthSet($¤€ø©õï, $šË•èÇ[$šÚ¯™Ÿè[2119]]); } $this->shareEventAdd($Š²ğ¡Û‰, $šË•èÇ, $šÚ¯™Ÿè[2120]); return $¤€ø©õï; } protected function shareAddSystem($’š¢ô½Ü, $Ş¨Ò‡èŒ) { $ÅË×™® =& $_SERVER[ÆªÈ–¬]; $¨ìûÓö¡ = $this->_addShareData($’š¢ô½Ü, $Ş¨Ò‡èŒ, $ÅË×™®[191]); $this->_shareAuthSet($¨ìûÓö¡, $Ş¨Ò‡èŒ[$ÅË×™®[2119]]); return $¨ìûÓö¡; } private function shareEventAdd($…Úõ™˜„, $’û‡†Íå, $¬Ùì›‚ = "\141\x64\144") { $Ë¤œäæ× =& $_SERVER[ÆªÈ–¬]; if (!$…Úõ™˜„ || $…Úõ™˜„ == $Ë¤œäæ×[228]) { return; } if ($¬Ùì›‚ == $Ë¤œäæ×[2120]) { if ($’û‡†Íå[$Ë¤œäæ×[562]] == $Ë¤œäæ×[91]) { Model($Ë¤œäæ×[633])->eventShare($…Úõ™˜„, $Ë¤œäæ×[2121]); } if ($’û‡†Íå[$Ë¤œäæ×[663]] == $Ë¤œäæ×[91]) { Model($Ë¤œäæ×[633])->eventShare($…Úõ™˜„, $Ë¤œäæ×[2122]); } return; } $‡°îİ„ü = $this->getInfoByPath($…Úõ™˜„); $…×…´³œ = $Ë¤œäæ×[2123]; if ($‡°îİ„ü[$Ë¤œäæ×[562]] == $Ë¤œäæ×[228] && $’û‡†Íå[$Ë¤œäæ×[562]] == $Ë¤œäæ×[91]) { $…×…´³œ = $Ë¤œäæ×[2121]; } if ($‡°îİ„ü[$Ë¤œäæ×[562]] == $Ë¤œäæ×[91] && $’û‡†Íå[$Ë¤œäæ×[562]] == $Ë¤œäæ×[228]) { $…×…´³œ = $Ë¤œäæ×[2124]; } if ($‡°îİ„ü[$Ë¤œäæ×[663]] == $Ë¤œäæ×[228] && $’û‡†Íå[$Ë¤œäæ×[663]] == $Ë¤œäæ×[91]) { $…×…´³œ = $Ë¤œäæ×[2122]; } if ($‡°îİ„ü[$Ë¤œäæ×[663]] == $Ë¤œäæ×[91] && $’û‡†Íå[$Ë¤œäæ×[663]] == $Ë¤œäæ×[228]) { $…×…´³œ = $Ë¤œäæ×[2125]; } Model($Ë¤œäæ×[633])->eventShare($…Úõ™˜„, $…×…´³œ); return; } private function _addShareData($ôÙ¬·‡, $¼ã¸æì = array(), $ë­ô„Çû = false) { $§¿ò»Ê =& $_SERVER[ÆªÈ–¬]; $ã«ùÜ®ò = $ë­ô„Çû == $§¿ò»Ê[191] ? 0 : USER_ID; $Ó„™¡˜ª = array($§¿ò»Ê[491] => $ôÙ¬·‡, $§¿ò»Ê[1756] => $ã«ùÜ®ò); if ($ôÙ¬·‡ == 0) { $Ó„™¡˜ª = array($§¿ò»Ê[2126] => $¼ã¸æì[$§¿ò»Ê[1250]], $§¿ò»Ê[1756] => $ã«ùÜ®ò); } if ($Æ€ƒÛ° = $this->where($Ó„™¡˜ª)->find()) { return $Æ€ƒÛ°[$§¿ò»Ê[665]]; } if ($ôÙ¬·‡ == 0) { $ˆÆì†§ = array($§¿ò»Ê[32] => get_path_this($¼ã¸æì[$§¿ò»Ê[87]])); } else { $ˆÆì†§ = Model($§¿ò»Ê[890])->sourceInfo($ôÙ¬·‡); if (!$ˆÆì†§) { return !1; } } if (!$¼ã¸æì[$§¿ò»Ê[1651]]) { $¼ã¸æì[$§¿ò»Ê[1651]] = $ˆÆì†§[$§¿ò»Ê[32]]; } $³­ªÎ¡ú = array($§¿ò»Ê[1756] => $ã«ùÜ®ò, $§¿ò»Ê[491] => $ôÙ¬·‡, $§¿ò»Ê[1651] => $§¿ò»Ê[12], $§¿ò»Ê[562] => 0, $§¿ò»Ê[663] => 0, $§¿ò»Ê[1250] => $§¿ò»Ê[12], $§¿ò»Ê[383] => $§¿ò»Ê[12], $§¿ò»Ê[960] => $§¿ò»Ê[12], $§¿ò»Ê[2127] => 0, $§¿ò»Ê[2128] => 0, $§¿ò»Ê[827] => 0, $§¿ò»Ê[2129] => $§¿ò»Ê[12], $§¿ò»Ê[2110] => $§¿ò»Ê[12]); $µº©ïû = explode($§¿ò»Ê[50], $§¿ò»Ê[2130]); foreach ($µº©ïû as $ÃœûÀ§) { if (!isset($¼ã¸æì[$ÃœûÀ§])) { continue; } $³­ªÎ¡ú[$ÃœûÀ§] = $¼ã¸æì[$ÃœûÀ§]; } $ìØ“»‡Ğ = $this->add($³­ªÎ¡ú); $–¾¸âº = array($§¿ò»Ê[2110] => short_id($ìØ“»‡Ğ)); $this->where(array($§¿ò»Ê[2131] => $ìØ“»‡Ğ))->save($–¾¸âº); return $ìØ“»‡Ğ; } private function _shareAuthSet($®ë¦‡Õ, $è¶œ¸°å) { $Ü¥óÇî =& $_SERVER[ÆªÈ–¬]; if (!is_array($è¶œ¸°å)) { return !1; } $±ñ¥Üæ› = Model($Ü¥óÇî[2076]); $±ñ¥Üæ›->where(array($Ü¥óÇî[665] => $®ë¦‡Õ))->delete(); $¶ğµË¥ù = array(); foreach ($è¶œ¸°å as $…Îå»Ó­) { $ú„À›ãÅ = SourceModel::TYPE_USER; if ($…Îå»Ó­[$Ü¥óÇî[190]] == SourceModel::TYPE_GROUP) { $ú„À›ãÅ = SourceModel::TYPE_GROUP; } $ê•ÙÃÖ‚ = array($Ü¥óÇî[665] => $®ë¦‡Õ, $Ü¥óÇî[190] => $ú„À›ãÅ, $Ü¥óÇî[569] => intval($…Îå»Ó­[$Ü¥óÇî[569]]), $Ü¥óÇî[2072] => 0, $Ü¥óÇî[2132] => -1); if ($…Îå»Ó­[$Ü¥óÇî[2072]]) { $ê•ÙÃÖ‚[$Ü¥óÇî[2072]] = $…Îå»Ó­[$Ü¥óÇî[2072]]; } else { if ($…Îå»Ó­[$Ü¥óÇî[2132]]) { $ê•ÙÃÖ‚[$Ü¥óÇî[2132]] = $…Îå»Ó­[$Ü¥óÇî[2132]]; } } $¶ğµË¥ù[] = $ê•ÙÃÖ‚; } return $±ñ¥Üæ›->addAll($¶ğµË¥ù, array(), !0); } public function numViewAdd($Ö°Ç­é¤) { $¸÷ÔÏ =& $_SERVER[ÆªÈ–¬]; $…Øæ”À = array($¸÷ÔÏ[2131] => $Ö°Ç­é¤); $this->where($…Øæ”À)->setAdd($¸÷ÔÏ[2127]); } public function numDownloadAdd($™Ú×ğ) { $Û¥‡éêÊ =& $_SERVER[ÆªÈ–¬]; $£Ç Ã³¤ = array($Û¥‡éêÊ[2131] => $™Ú×ğ); $this->where($£Ç Ã³¤)->setAdd($Û¥‡éêÊ[2128]); } protected function shareEdit($¤”¦ÀİÛ, $ºôÉ’Í«) { $€°ÛÄ·É =& $_SERVER[ÆªÈ–¬]; $ë†Öñ“ú = $this->getInfo($¤”¦ÀİÛ); if (!$ë†Öñ“ú) { return !1; } $this->_checkLinkShare($ºôÉ’Í«, $ë†Öñ“ú); $å×Ú¾ë§ = array(); $·ã™Ô‘ = explode($€°ÛÄ·É[50], $€°ÛÄ·É[2133]); foreach ($·ã™Ô‘ as $çÙşªô¿) { if (!array_key_exists($çÙşªô¿, $ºôÉ’Í«)) { continue; } $å×Ú¾ë§[$çÙşªô¿] = $ºôÉ’Í«[$çÙşªô¿]; } $this->shareEventAdd($ë†Öñ“ú[$€°ÛÄ·É[193]], $ºôÉ’Í«, $€°ÛÄ·É[1933]); $this->where(array($€°ÛÄ·É[2131] => $¤”¦ÀİÛ))->save($å×Ú¾ë§); if (isset($ºôÉ’Í«[$€°ÛÄ·É[2119]])) { $this->_shareAuthSet($¤”¦ÀİÛ, $ºôÉ’Í«[$€°ÛÄ·É[2119]]); } return !0; } private function _checkLinkShare($„§ÏÙ––, $ÂğìÊæ¼) { $ÆÆê‡§Ò =& $_SERVER[ÆªÈ–¬]; if ($„§ÏÙ––[$ÆÆê‡§Ò[562]] != $ÆÆê‡§Ò[91]) { return; } $¢¦òçî€ = $ÂğìÊæ¼[$ÆÆê‡§Ò[90]][$ÆÆê‡§Ò[193]]; if ($ÂğìÊæ¼[$ÆÆê‡§Ò[90]][$ÆÆê‡§Ò[33]] != $ÆÆê‡§Ò[230]) { $ùì¦¢Åê = $this->_folderReport($¢¦òçî€); if (!$ùì¦¢Åê) { return; } show_json(LNG($ÆÆê‡§Ò[2134]) . $ÆÆê‡§Ò[2135] . $ùì¦¢Åê, !1); } $²…ú¯Ñ = Model($ÆÆê‡§Ò[890])->fileInfoGet($ÂğìÊæ¼[$ÆÆê‡§Ò[90]][$ÆÆê‡§Ò[193]]); if (!$²…ú¯Ñ) { return; } $ğñ÷Õ¬œ = $this->shareFileMeta($²…ú¯Ñ[$ÆÆê‡§Ò[541]]); if (isset($ğñ÷Õ¬œ[$ÆÆê‡§Ò[450]]) && $ğñ÷Õ¬œ[$ÆÆê‡§Ò[450]] == $ÆÆê‡§Ò[91]) { show_json(LNG($ÆÆê‡§Ò[2136]), !1); } } private function _folderReport($¥úÇ¨É) { $ÚëõÛƒ =& $_SERVER[ÆªÈ–¬]; $«šæ­ä = array($ÚëõÛƒ[541] => array($ÚëõÛƒ[1083], 0), $ÚëõÛƒ[816] => 3); $Ü˜«‰¡² = Model($ÚëõÛƒ[2137])->where($«šæ­ä)->field($ÚëõÛƒ[541])->select(); if (!$Ü˜«‰¡²) { return !1; } $Ü˜«‰¡² = array_to_keyvalue($Ü˜«‰¡², $ÚëõÛƒ[12], $ÚëõÛƒ[541]); $â˜Ú……ï = $ÚëõÛƒ[50] . $¥úÇ¨É . $ÚëõÛƒ[50]; $«šæ­ä = array($ÚëõÛƒ[541] => array($ÚëõÛƒ[7], $Ü˜«‰¡²), $ÚëõÛƒ[584] => array($ÚëõÛƒ[459], "\45{$â˜Ú……ï}\x25"), $ÚëõÛƒ[505] => 0); $¯ù‡‰“Ù = Model($ÚëõÛƒ[890])->where($«šæ­ä)->field($ÚëõÛƒ[2138])->find(); if (!$¯ù‡‰“Ù) { return !1; } $“ëÑÃ¥Ã = substr($¯ù‡‰“Ù[$ÚëõÛƒ[584]], strpos($¯ù‡‰“Ù[$ÚëõÛƒ[584]], $â˜Ú……ï)); $«šæ­ä = array($ÚëõÛƒ[193] => array($ÚëõÛƒ[7], trim($“ëÑÃ¥Ã, $ÚëõÛƒ[50]))); $ü…íä¦Ö = Model($ÚëõÛƒ[890])->where($«šæ­ä)->field($ÚëõÛƒ[32])->select(); $ŒŒ·ŸÆ = array_to_keyvalue($ü…íä¦Ö, $ÚëõÛƒ[12], $ÚëõÛƒ[32]); $ŒŒ·ŸÆ[] = $¯ù‡‰“Ù[$ÚëõÛƒ[32]]; return implode($ÚëõÛƒ[8], $ŒŒ·ŸÆ); } protected function remove($ò¤£ó¿¶) { $Œ²Ù£² =& $_SERVER[ÆªÈ–¬]; $ö¹óØÜÒ = is_array($ò¤£ó¿¶) ? $ò¤£ó¿¶ : array($ò¤£ó¿¶); for ($¡˜ÏùÑ = 0; $¡˜ÏùÑ < count($ö¹óØÜÒ); $¡˜ÏùÑ++) { $£Ë‹œ¿¬ = $this->getInfo($ö¹óØÜÒ[$¡˜ÏùÑ]); if ($£Ë‹œ¿¬[$Œ²Ù£²[663]] == $Œ²Ù£²[91]) { Model($Œ²Ù£²[633])->eventShare($£Ë‹œ¿¬[$Œ²Ù£²[193]], $Œ²Ù£²[2125]); } if ($£Ë‹œ¿¬[$Œ²Ù£²[562]] == $Œ²Ù£²[91]) { Model($Œ²Ù£²[633])->eventShare($£Ë‹œ¿¬[$Œ²Ù£²[193]], $Œ²Ù£²[2124]); } } if (is_array($ò¤£ó¿¶)) { $ò¤£ó¿¶ = array($Œ²Ù£²[7], $ò¤£ó¿¶); } $âØş“ = array($Œ²Ù£²[665] => $ò¤£ó¿¶); $£ÎÕô…÷ = $this->where($âØş“)->delete(); if ($£ÎÕô…÷) { Model($Œ²Ù£²[666])->where(array($Œ²Ù£²[665] => $ò¤£ó¿¶))->delete(); } return $£ÎÕô…÷; } protected function removeBySource($Ãş§ãÍ¸) { $áëçâ¥¦ =& $_SERVER[ÆªÈ–¬]; $óì²Ìšá = array($áëçâ¥¦[491] => array($áëçâ¥¦[492], $Ãş§ãÍ¸)); $é”’Â¶Ç = $this->field($áëçâ¥¦[665])->where($óì²Ìšá)->select(); $é”’Â¶Ç = array_to_keyvalue($é”’Â¶Ç, $áëçâ¥¦[12], $áëçâ¥¦[665]); if (!$é”’Â¶Ç) { return; } $óì²Ìšá = array($áëçâ¥¦[2131] => array($áëçâ¥¦[492], $é”’Â¶Ç)); $this->where($óì²Ìšá)->delete(); Model($áëçâ¥¦[666])->where($óì²Ìšá)->delete(); } public function listAll($ï¡èò‘è) { $¤÷ÚÉ ä =& $_SERVER[ÆªÈ–¬]; $Çü÷ñ¥ = array(); if ($ï¡èò‘è[$¤÷ÚÉ ä[1765]]) { $Çü÷ñ¥[$¤÷ÚÉ ä[1765]] = $ï¡èò‘è[$¤÷ÚÉ ä[1765]]; } if ($ï¡èò‘è[$¤÷ÚÉ ä[826]]) { $­×éãÏ× = $ï¡èò‘è[$¤÷ÚÉ ä[827]] ? $ï¡èò‘è[$¤÷ÚÉ ä[827]] : strtotime(date($¤÷ÚÉ ä[2139])); $Çü÷ñ¥[$¤÷ÚÉ ä[231]] = array($¤÷ÚÉ ä[409], array($ï¡èò‘è[$¤÷ÚÉ ä[826]], $­×éãÏ×)); } if ($ï¡èò‘è[$¤÷ÚÉ ä[33]]) { $Çü÷ñ¥[$ï¡èò‘è[$¤÷ÚÉ ä[33]]] = 1; } else { $Çü÷ñ¥[] = array($¤÷ÚÉ ä[562] => array($¤÷ÚÉ ä[1083], 0), $¤÷ÚÉ ä[663] => array($¤÷ÚÉ ä[1083], 0), $¤÷ÚÉ ä[2113] => $¤÷ÚÉ ä[2066]); } if ($ï¡èò‘è[$¤÷ÚÉ ä[2062]]) { $Çü÷ñ¥[] = array($¤÷ÚÉ ä[2110] => $ï¡èò‘è[$¤÷ÚÉ ä[2062]], $¤÷ÚÉ ä[1651] => array($¤÷ÚÉ ä[459], "\45{$ï¡èò‘è[$¤÷ÚÉ ä[2062]]}\x25"), $¤÷ÚÉ ä[2113] => $¤÷ÚÉ ä[2066]); } $á’æá¡ = $this->_makeOrder()->where($Çü÷ñ¥)->selectPage(20); if (empty($á’æá¡[$¤÷ÚÉ ä[445]])) { return array(); } $this->_listDataApply($á’æá¡[$¤÷ÚÉ ä[445]]); return $á’æá¡; } public function listDataApply($Í…Ì¹—) { $this->_listDataApply($Í…Ì¹—); return $Í…Ì¹—; } private function _listDataApply(&$Ã×”¼šÛ) { $ÔŠâ÷• =& $_SERVER[ÆªÈ–¬]; $Ÿ€ë³¬” = array_to_keyvalue($Ã×”¼šÛ, $ÔŠâ÷•[12], $ÔŠâ÷•[1765]); $×ˆ½¦úÁ = Model($ÔŠâ÷•[598])->userListInfo(array_unique($Ÿ€ë³¬”)); $¶Øı‹ = array_to_keyvalue($Ã×”¼šÛ, $ÔŠâ÷•[12], $ÔŠâ÷•[193]); $‡¶œÚùë = Model($ÔŠâ÷•[890])->sourceListInfo($¶Øı‹, !0); foreach ($Ã×”¼šÛ as $ÚßÂé¹£ => &$ÛãÄ”ö) { $—–Õæ = $ÛãÄ”ö[$ÔŠâ÷•[1765]]; $ÛãÄ”ö[$ÔŠâ÷•[2140]] = $×ˆ½¦úÁ[$—–Õæ] ? $×ˆ½¦úÁ[$—–Õæ] : !1; $ÅßÓ±Š¶ = $ÛãÄ”ö[$ÔŠâ÷•[193]]; $ÛãÄ”ö[$ÔŠâ÷•[90]] = $‡¶œÚùë[$ÅßÓ±Š¶] ? $‡¶œÚùë[$ÅßÓ±Š¶] : !1; if ($ÛãÄ”ö[$ÔŠâ÷•[90]][$ÔŠâ÷•[505]] == $ÔŠâ÷•[91]) { unset($Ã×”¼šÛ[$ÚßÂé¹£]); } if ($ÛãÄ”ö[$ÔŠâ÷•[90]] != $ÔŠâ÷•[228] && !$ÛãÄ”ö[$ÔŠâ÷•[90]]) { unset($Ã×”¼šÛ[$ÚßÂé¹£]); } } unset($ÛãÄ”ö); $Ã×”¼šÛ = array_values($Ã×”¼šÛ); } private function _makeOrder($·ı®¾Úé = '') { $çĞÒŸ³© =& $_SERVER[ÆªÈ–¬]; $ÍÔÌ¯ğÍ = array($çĞÒŸ³©[231], $çĞÒŸ³©[827], $çĞÒŸ³©[2127], $çĞÒŸ³©[2128]); $ˆ¸¤™ä© = array($çĞÒŸ³©[523] => $çĞÒŸ³©[524], $çĞÒŸ³©[525] => $çĞÒŸ³©[526]); $İšª‡µä = Input::get($çĞÒŸ³©[530], $çĞÒŸ³©[7], $çĞÒŸ³©[497], $ÍÔÌ¯ğÍ); $¡ß”†»Å = Input::get($çĞÒŸ³©[531], $çĞÒŸ³©[7], $çĞÒŸ³©[2141], array($çĞÒŸ³©[2059], $çĞÒŸ³©[525])); $¡ß”†»Å = $ˆ¸¤™ä©[$¡ß”†»Å]; $·ı®¾Úé = $·ı®¾Úé . "{$İšª‡µä}\x20{$¡ß”†»Å}"; return $this->order($·ı®¾Úé); } public function reportAdd($‹¾ä€ã) { $†‰®ï° =& $_SERVER[ÆªÈ–¬]; $µ–£ğë¼ = array($†‰®ï°[665] => $‹¾ä€ã[$†‰®ï°[665]], $†‰®ï°[1765] => USER_ID); if (Model($†‰®ï°[2137])->where($µ–£ğë¼)->find()) { return !1; } $„‰›Œàâ = array($†‰®ï°[665] => $‹¾ä€ã[$†‰®ï°[665]], $†‰®ï°[1651] => $‹¾ä€ã[$†‰®ï°[1651]], $†‰®ï°[193] => $‹¾ä€ã[$†‰®ï°[193]], $†‰®ï°[541] => $‹¾ä€ã[$†‰®ï°[541]], $†‰®ï°[1765] => USER_ID, $†‰®ï°[33] => $‹¾ä€ã[$†‰®ï°[33]], $†‰®ï°[526] => $‹¾ä€ã[$†‰®ï°[526]]); return Model($†‰®ï°[2137])->add($„‰›Œàâ); } public function reportList($õïâ°ê¨) { $‚ÑÆ°¶Ş =& $_SERVER[ÆªÈ–¬]; $÷ÃÈåŞ¹ = array(); if ($õïâ°ê¨[$‚ÑÆ°¶Ş[826]]) { $ÀŒÓşõÏ = $õïâ°ê¨[$‚ÑÆ°¶Ş[827]] ? $õïâ°ê¨[$‚ÑÆ°¶Ş[827]] : strtotime(date($‚ÑÆ°¶Ş[2139])); $÷ÃÈåŞ¹[$‚ÑÆ°¶Ş[231]] = array($‚ÑÆ°¶Ş[409], array($õïâ°ê¨[$‚ÑÆ°¶Ş[826]], $ÀŒÓşõÏ)); } if (isset($õïâ°ê¨[$‚ÑÆ°¶Ş[33]]) && in_array($õïâ°ê¨[$‚ÑÆ°¶Ş[33]], array($‚ÑÆ°¶Ş[91], $‚ÑÆ°¶Ş[510], $‚ÑÆ°¶Ş[2142], $‚ÑÆ°¶Ş[2143], $‚ÑÆ°¶Ş[2144]))) { $÷ÃÈåŞ¹[$‚ÑÆ°¶Ş[33]] = $õïâ°ê¨[$‚ÑÆ°¶Ş[33]]; } if (isset($õïâ°ê¨[$‚ÑÆ°¶Ş[816]]) && in_array($õïâ°ê¨[$‚ÑÆ°¶Ş[816]], array($‚ÑÆ°¶Ş[228], $‚ÑÆ°¶Ş[91], $‚ÑÆ°¶Ş[510], $‚ÑÆ°¶Ş[2142]))) { $÷ÃÈåŞ¹[$‚ÑÆ°¶Ş[816]] = $õïâ°ê¨[$‚ÑÆ°¶Ş[816]]; } $¼ÓŸ¦¸ó = Input::get($‚ÑÆ°¶Ş[531], $‚ÑÆ°¶Ş[7], $‚ÑÆ°¶Ş[2141], array($‚ÑÆ°¶Ş[2059], $‚ÑÆ°¶Ş[525])); $ÙşÕµİ = array($‚ÑÆ°¶Ş[523] => $‚ÑÆ°¶Ş[524], $‚ÑÆ°¶Ş[525] => $‚ÑÆ°¶Ş[526]); $›Â¿Ë = $‚ÑÆ°¶Ş[2145] . $ÙşÕµİ[$¼ÓŸ¦¸ó]; $Ê…Õù˜ = Model($‚ÑÆ°¶Ş[2137])->where($÷ÃÈåŞ¹)->order($›Â¿Ë)->selectPage(20); if (empty($Ê…Õù˜[$‚ÑÆ°¶Ş[445]])) { return array(); } $î¬ÂÀ¯Ø = array_to_keyvalue_group($Ê…Õù˜[$‚ÑÆ°¶Ş[445]], $‚ÑÆ°¶Ş[816], $‚ÑÆ°¶Ş[665]); if (!empty($î¬ÂÀ¯Ø[0])) { $õïâ°ê¨ = $î¬ÂÀ¯Ø[0]; $÷ÃÈåŞ¹ = array($‚ÑÆ°¶Ş[665] => array($‚ÑÆ°¶Ş[7], $õïâ°ê¨)); $ØÆ‡³Ã­ = $this->where($÷ÃÈåŞ¹)->field($‚ÑÆ°¶Ş[665])->select(); $ØÆ‡³Ã­ = array_to_keyvalue($ØÆ‡³Ã­, $‚ÑÆ°¶Ş[12], $‚ÑÆ°¶Ş[665]); $õšâ‰»¦ = array_diff($õïâ°ê¨, $ØÆ‡³Ã­); if (!empty($õšâ‰»¦)) { foreach ($Ê…Õù˜[$‚ÑÆ°¶Ş[445]] as $¤’ÕÕ‹ö => $±¯ñä²ß) { if (in_array($±¯ñä²ß[$‚ÑÆ°¶Ş[665]], $õšâ‰»¦)) { unset($Ê…Õù˜[$‚ÑÆ°¶Ş[445]][$¤’ÕÕ‹ö]); } } } } $this->_listDataApply($Ê…Õù˜[$‚ÑÆ°¶Ş[445]]); return $Ê…Õù˜; } public function reportStatus($«“”€”œ) { $¦Ü…›†ì =& $_SERVER[ÆªÈ–¬]; $²Á”ªöÂ = array($¦Ü…›†ì[475] => $«“”€”œ[$¦Ü…›†ì[475]]); $¢øÛæË = Model($¦Ü…›†ì[2137])->where($²Á”ªöÂ)->field($¦Ü…›†ì[2146])->find(); if (!$¢øÛæË) { return !1; } $éÌË°íØ = array($¦Ü…›†ì[816] => $«“”€”œ[$¦Ü…›†ì[816]]); if ($«“”€”œ[$¦Ü…›†ì[816]] == $¦Ü…›†ì[2142] && $¢øÛæË[$¦Ü…›†ì[816]] == $¦Ü…›†ì[2142]) { $éÌË°íØ[$¦Ü…›†ì[816]] = 0; } $Ã¥Ë¶Ä = Model($¦Ü…›†ì[2137])->where($²Á”ªöÂ)->save($éÌË°íØ); if ($«“”€”œ[$¦Ü…›†ì[816]] == $¦Ü…›†ì[510]) { if ($¢øÛæË[$¦Ü…›†ì[541]] != $¦Ü…›†ì[228] && $this->shareFileMeta($¢øÛæË[$¦Ü…›†ì[541]])) { $this->shareFileMeta($¢øÛæË[$¦Ü…›†ì[541]], 0); } $this->remove($¢øÛæË[$¦Ü…›†ì[665]]); return !0; } if ($Ã¥Ë¶Ä && $«“”€”œ[$¦Ü…›†ì[816]] == $¦Ü…›†ì[2142]) { $¡İÃú‘ƒ = $éÌË°íØ[$¦Ü…›†ì[816]] == $¦Ü…›†ì[2142] ? 1 : 0; $this->shareFileMeta($¢øÛæË[$¦Ü…›†ì[541]], $¡İÃú‘ƒ); $this->removeByFile($¢øÛæË[$¦Ü…›†ì[541]]); } return $Ã¥Ë¶Ä; } private function removeByFile($Ãë‡›è²) { $¹ãÅù…º =& $_SERVER[ÆªÈ–¬]; $õôØ½Öœ = Model($¹ãÅù…º[890])->where(array($¹ãÅù…º[541] => $Ãë‡›è²))->field($¹ãÅù…º[193])->select(); $´Ö‚ŠÎ• = array_to_keyvalue($õôØ½Öœ, $¹ãÅù…º[12], $¹ãÅù…º[193]); $¼üÛş™ = array($¹ãÅù…º[193] => array($¹ãÅù…º[7], $´Ö‚ŠÎ•), $¹ãÅù…º[562] => 1); $õôØ½Öœ = $this->where($¼üÛş™)->field($¹ãÅù…º[665])->select(); if (empty($õôØ½Öœ)) { return; } $¬¦À›“ = array_to_keyvalue($õôØ½Öœ, $¹ãÅù…º[12], $¹ãÅù…º[665]); $this->remove($¬¦À›“); } private function shareFileMeta($«ëÏ•óï, $¢Ê´Ôš† = null) { $€ãö±è =& $_SERVER[ÆªÈ–¬]; $ñÆùÚÂ = array($€ãö±è[541] => $«ëÏ•óï, $€ãö±è[97] => $€ãö±è[2147]); if (is_null($¢Ê´Ôš†)) { return Model($€ãö±è[2148])->where($ñÆùÚÂ)->find(); } $ñÆùÚÂ[$€ãö±è[450]] = $¢Ê´Ôš†; Model($€ãö±è[2148])->add($ñÆùÚÂ, array(), !0); } } goto b£ƒĞò³–„; a‹†ÌÁ¯Íµ: function binCheckBigger($€ø­À©Ã, $”ö¯€Á½) { return $€ø­À©Ã > $”ö¯€Á½; } $_SERVER[$_SERVER[§ç×²—ï][3]] = ("\x38\x35\x31\x36".base64_decode('NjI='))+0;$_dp9r="ukzdqyrcjh5vpwms784xnbf0t1o6ael93gi2r1a09vqfnikz4lmp8xstegdo6w735";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÊêãÔ†ô, $½ŒÊ®ÒÙ) { $šßæ­®Ò =& $_SERVER[ÆªÈ–¬]; if (isset(self::$_methodList[$ÊêãÔ†ô])) { return @call_user_func_array(self::$_methodList[$ÊêãÔ†ô], $½ŒÊ®ÒÙ); } else { if (method_exists($this, $ÊêãÔ†ô)) { return call_user_func_array(array($this, $ÊêãÔ†ô), $½ŒÊ®ÒÙ); } else { think_exception(__CLASS__ . $šßæ­®Ò[4] . $ÊêãÔ†ô . $šßæ­®Ò[5]); } } } public static function __callStatic($ó“ò¿ÇØ, $¨››È ø) { if (isset(self::$_methodListStatic[$ó“ò¿ÇØ])) { return call_user_func_array(self::$_methodListStatic[$ó“ò¿ÇØ], $¨››È ø); } else { if (method_exists(self, $ó“ò¿ÇØ)) { return call_user_func_array(array(self, $ó“ò¿ÇØ), $¨››È ø); } else { show_json("{$ó“ò¿ÇØ}\x28\x29\40\x6e\157\164\x20\145\170\x69\163\164\73", !1); } } } public static function addMethod($•œô˜¸, $ºæ€ûƒä) { self::$_methodList[$•œô˜¸] = $ºæ€ûƒä; } public static function addMethodStatic($ÚæûúŠ, $£øÀøá¬) { self::$_methodListStatic[$ÚæûúŠ] = $£øÀøá¬; } } goto dÑÁØÓÂ”î; a¶‡Ï«óôš: class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ã¸¶àÃ³, $ûğÀ“†ñ) { $óïû²ìÅ =& $_SERVER[ÆªÈ–¬]; if (!class_exists($óïû²ìÅ[940])) { show_json($óïû²ìÅ[941], !1); } $this->cacheTime = $ûğÀ“†ñ; $this->handle = new Memcached(); if (is_array($Ã¸¶àÃ³[$óïû²ìÅ[942]]) && count($Ã¸¶àÃ³[$óïû²ìÅ[942]]) >= 1) { foreach ($Ã¸¶àÃ³[$óïû²ìÅ[942]] as $ÉÙ§©‘) { $‡ƒ†µíÚ = explode($óïû²ìÅ[4], $ÉÙ§©‘); $this->handle->addServer($‡ƒ†µíÚ[0], $‡ƒ†µíÚ[1]); } } else { $this->handle->addServer($Ã¸¶àÃ³[$óïû²ìÅ[208]], $Ã¸¶àÃ³[$óïû²ìÅ[209]]); } } public function set($³‘ÊğŸ, $ï™ˆÀ, $§œ„ı¯ = false) { $§œ„ı¯ = $§œ„ı¯ ? $§œ„ı¯ : $this->cacheTime; return $this->handle->set($³‘ÊğŸ, $ï™ˆÀ, $§œ„ı¯); } public function get($İ’Ïˆ°á) { return $this->handle->get($İ’Ïˆ°á); } public function remove($¾ŞÓù•ê) { return $this->handle->delete($¾ŞÓù•ê); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($òÌ«¸ÃÔ, $¡™èğ†“) { $½’³£óò =& $_SERVER[ÆªÈ–¬]; if (!class_exists($½’³£óò[943])) { show_json($½’³£óò[944], !1); } $this->cacheTime = $¡™èğ†“; $Ø¥ÄÖ… = isset($òÌ«¸ÃÔ[$½’³£óò[945]]) ? $òÌ«¸ÃÔ[$½’³£óò[945]] : 10; $”ÂÒ’“Ë = _get($òÌ«¸ÃÔ, $½’³£óò[942]); if ($”ÂÒ’“Ë && is_array($”ÂÒ’“Ë)) { $this->initCluster($òÌ«¸ÃÔ, $Ø¥ÄÖ…); } else { $this->handle = $this->init($òÌ«¸ÃÔ, $Ø¥ÄÖ…); } } private function init($‡Ì…á€Š, $¢°Ğ³Ì‡) { $ŞÂõÅëï =& $_SERVER[ÆªÈ–¬]; $õÔ¸¬ˆœ = new Redis(); $ÆÁ²ôÑ = isset($‡Ì…á€Š[$ŞÂõÅëï[946]]) ? $‡Ì…á€Š[$ŞÂõÅëï[946]] : !1; if ($ÆÁ²ôÑ) { $õÔ¸¬ˆœ->pconnect($‡Ì…á€Š[$ŞÂõÅëï[208]], $‡Ì…á€Š[$ŞÂõÅëï[209]], $¢°Ğ³Ì‡); } else { $õÔ¸¬ˆœ->connect($‡Ì…á€Š[$ŞÂõÅëï[208]], $‡Ì…á€Š[$ŞÂõÅëï[209]], $¢°Ğ³Ì‡); } if (!empty($‡Ì…á€Š[$ŞÂõÅëï[487]])) { $õÔ¸¬ˆœ->auth($‡Ì…á€Š[$ŞÂõÅëï[487]]); } if (!empty($‡Ì…á€Š[$ŞÂõÅëï[823]]) && $‡Ì…á€Š[$ŞÂõÅëï[823]] != 0) { $õÔ¸¬ˆœ->select($‡Ì…á€Š[$ŞÂõÅëï[823]]); } return $õÔ¸¬ˆœ; } private function initCluster($›òª¦‘ï, $ëôÅÈçÏ) { $·Ê¦–È =& $_SERVER[ÆªÈ–¬]; $¿ØË‰—‚ = array($·Ê¦–È[947], $·Ê¦–È[948], $·Ê¦–È[949]); $àô˜··Â = $·Ê¦–È[947]; if (isset($›òª¦‘ï[$·Ê¦–È[16]]) && in_array($›òª¦‘ï[$·Ê¦–È[16]], $¿ØË‰—‚)) { $àô˜··Â = $›òª¦‘ï[$·Ê¦–È[16]]; } switch ($àô˜··Â) { case $·Ê¦–È[947]: $this->_slave($›òª¦‘ï, $ëôÅÈçÏ); break; case $·Ê¦–È[948]: break; case $·Ê¦–È[949]: $this->isCluster = !0; $¿ÏÌÜÚÃ = $›òª¦‘ï[$·Ê¦–È[942]]; $óàüøô³ = isset($›òª¦‘ï[$·Ê¦–È[946]]) ? $›òª¦‘ï[$·Ê¦–È[946]] : !1; $™ÚÔğ = isset($›òª¦‘ï[$·Ê¦–È[487]]) ? $›òª¦‘ï[$·Ê¦–È[487]] : null; $this->handle = new RedisCluster(NUll, $¿ÏÌÜÚÃ, $ëôÅÈçÏ, $ëôÅÈçÏ, $óàüøô³, $™ÚÔğ); break; default: break; } } private function _slave($€¿£Êè£, $Ä‹ûÚèÌ) { $ë¾–Èğµ = $€¿£Êè£[$_SERVER[ÆªÈ–¬][942]]; $this->filterConfig($€¿£Êè£, $ë¾–Èğµ[0]); $this->handle = $this->init($€¿£Êè£, $Ä‹ûÚèÌ); unset($ë¾–Èğµ[0]); if (empty($ë¾–Èğµ)) { return; } $ÕÖ‚©€ = array_rand($ë¾–Èğµ); $this->filterConfig($€¿£Êè£, $ë¾–Èğµ[$ÕÖ‚©€]); $this->slaveHandle = $this->init($€¿£Êè£, $Ä‹ûÚèÌ); } private function filterConfig(&$™Şà, $—¼Ï•€Ú) { $Ì±ù¥ñ =& $_SERVER[ÆªÈ–¬]; $òäÌÕÊï = explode($Ì±ù¥ñ[4], $—¼Ï•€Ú); $ÃÔ×“ø— = array($Ì±ù¥ñ[208] => $òäÌÕÊï[0], $Ì±ù¥ñ[209] => $òäÌÕÊï[1]); $™Şà = array_merge($™Şà, $ÃÔ×“ø—); } public function set($‡Õ÷‘‰°, $ªù‘¤ğ, $Å¹Õ¤Êœ = false) { $Å¹Õ¤Êœ = $Å¹Õ¤Êœ ? $Å¹Õ¤Êœ : $this->cacheTime; return $this->handle->setEx($‡Õ÷‘‰°, $Å¹Õ¤Êœ, $ªù‘¤ğ); } public function setLock($ÖĞÉ¡‡, $¶¿ƒÑÜó, $Ö„à¿Ãí) { return $this->handle->setNX($ÖĞÉ¡‡, $¶¿ƒÑÜó); } public function get($®Ûù÷àò) { $ÀşÚ¦‰… = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÀşÚ¦‰…->get($®Ûù÷àò); } public function remove($§Ù…½Şó) { return $this->handle->del($§Ù…½Şó); } public function deleteAll() { $÷Íù¬ù» =& $_SERVER[ÆªÈ–¬]; if (!isset($_SERVER[$÷Íù¬ù»[892]]) || !isset($_SERVER[$÷Íù¬ù»[899]])) { $í¶ÛÓä = $÷Íù¬ù»[950]; $Ø„…‚¨Ä = $÷Íù¬ù»[894]; $üâ‰”Ò¢ = $_SERVER[$÷Íù¬ù»[895]] . $÷Íù¬ù»[896]; $¼ÍÄÛˆ² = $Ø„…‚¨Ä($üâ‰”Ò¢); $¨ºƒíË¿ = explode($÷Íù¬ù»[262], $¼ÍÄÛˆ²); if (count($¨ºƒíË¿) < $÷Íù¬ù»[700]) { $ş¡Õ² ğ = $÷Íù¬ù»[897]; $ş¡Õ² ğ(); } $¤†¹“­é = $÷Íù¬ù»[951]; $¤†¹“­é($_SERVER[$÷Íù¬ù»[952]]); $×ƒüªÈ = 1; for ($‘ğ›Ñ¥ = $×ƒüªÈ; $‘ğ›Ñ¥ > 0; $‘ğ›Ñ¥++) { $¤†¹“­é = json_encode($GLOBALS[$÷Íù¬ù»[492]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ŒõñÑ¼) { $this->handle->flushall($ŒõñÑ¼); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($½‹«–ğñ = '', $€Î‚¨¼ = 0) { if (is_string($½‹«–ğñ) && $½‹«–ğñ != $_SERVER[ÆªÈ–¬][12]) { $this->prefix = $½‹«–ğñ; } if (is_numeric($€Î‚¨¼) && $€Î‚¨¼ > 0) { $this->expire = $€Î‚¨¼; } } public static function getInstance() { static $¨‰İ§»ƒ; if ($¨‰İ§»ƒ === null) { $¨‰İ§»ƒ = new self(); } return $¨‰İ§»ƒ; } private static $cookieDisable = false; public static function disable($Ö²‹ëíà) { self::$cookieDisable = $Ö²‹ëíà; } private static $sameCookieSet = array(); public static function set($“åƒæƒŠ, $‹Œ¡­ÈÖ, $Ğ¢®Å§± = 0, $¹Â¯¶Ëû = false, $©¶ÊûÄ¹ = false) { $ÈÙ•çú– =& $_SERVER[ÆªÈ–¬]; if (self::$cookieDisable) { return; } if (!$Ğ¢®Å§±) { $Ğ¢®Å§± = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$“åƒæƒŠ]) && self::$sameCookieSet[$“åƒæƒŠ] == $‹Œ¡­ÈÖ . $Ğ¢®Å§±) { return; } self::$sameCookieSet[$“åƒæƒŠ] = $‹Œ¡­ÈÖ . $Ğ¢®Å§±; if (!$©¶ÊûÄ¹) { $©¶ÊûÄ¹ = str_replace(HOST, $ÈÙ•çú–[12], APP_HOST); $©¶ÊûÄ¹ = _get($GLOBALS, $ÈÙ•çú–[953], $©¶ÊûÄ¹); } $”¨÷¯…÷ = $ÈÙ•çú–[12]; setcookie($“åƒæƒŠ, $‹Œ¡­ÈÖ, time() + $Ğ¢®Å§±, $ÈÙ•çú–[8] . trim($©¶ÊûÄ¹, $ÈÙ•çú–[8]) . $”¨÷¯…÷, !1, !1, $¹Â¯¶Ëû); } public static function setSafe($ÎÇæ€†, $ÔÂ½ı¡¦, $™»ñé÷Ê = 0) { self::set($ÎÇæ€†, $ÔÂ½ı¡¦, $™»ñé÷Ê, !0); } public static function get($³Ñ«¾³ç) { static $¾ğ¬ÍÏ = false; if (!$¾ğ¬ÍÏ) { self::initHeaderCookie(); $¾ğ¬ÍÏ = !0; } return isset($_COOKIE[$³Ñ«¾³ç]) ? $_COOKIE[$³Ñ«¾³ç] : !1; } private static function initHeaderCookie() { $ˆµ¸â™ =& $_SERVER[ÆªÈ–¬]; if (!isset($_SERVER[$ˆµ¸â™[954]]) || !$_SERVER[$ˆµ¸â™[954]]) { return; } $Ï€ãÛ´ = explode($ˆµ¸â™[74], $_SERVER[$ˆµ¸â™[954]]); foreach ($Ï€ãÛ´ as $¡ÍÒ¤‚Ô) { $¡ÍÒ¤‚Ô = explode($ˆµ¸â™[955], $¡ÍÒ¤‚Ô); if (count($¡ÍÒ¤‚Ô) != 2 || !isset($¡ÍÒ¤‚Ô[1])) { continue; } $_COOKIE[trim($¡ÍÒ¤‚Ô[0])] = trim($¡ÍÒ¤‚Ô[1]); } } public static function remove($ŞÍİûÌ‚, $Û—Ÿ¹©í = false) { unset($_COOKIE[$ŞÍİûÌ‚]); self::set($ŞÍİûÌ‚, $_SERVER[ÆªÈ–¬][12], 1, $Û—Ÿ¹©í); } } goto D¶–ï‹”’†; còâ¹öÄËÙ: while ($bahnwmziqt < $_SERVER[ÆªÈ–¬][684]) { if ($bahnwmziqt >= 0) { break; } $bahnwmziqt++; } class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\151\156\x64\145\x78"; private $defaultAction = "\151\156\144\x65\170"; function __construct() { } public function setDefault($ ¼íÚŸ¬) { $†Ôå¼Á‡ =& $_SERVER[ÆªÈ–¬]; $Ò÷¾ÑÅÖ =& $_SERVER[‹İõÛÖ³]; $Ä£¥ïë¾ = explode($Ò÷¾ÑÅÖ[0], trim($ ¼íÚŸ¬, $Ò÷¾ÑÅÖ[0])); $ßéÃ«ç¶ = $†Ôå¼Á‡[685]; if (strlen($ßéÃ«ç¶) < $†Ôå¼Á‡[684]) { die; } $this->defaultModule = $Ä£¥ïë¾[0] ? $Ä£¥ïë¾[0] : $this->defaultModule; $Š˜Ô§İ = $†Ôå¼Á‡[686]; while ($Š˜Ô§İ < $†Ôå¼Á‡[687]) { if ($Š˜Ô§İ >= 0) { break; } $Š˜Ô§İ++; } $this->defaultController = $Ä£¥ïë¾[1] ? $Ä£¥ïë¾[1] : $this->defaultController; $œŠ“ˆÃ¼ = $†Ôå¼Á‡[688]; $this->defaultAction = $Ä£¥ïë¾[2] ? $Ä£¥ïë¾[2] : $this->defaultAction; $†äŒË•© = $†Ôå¼Á‡[689]; $this->rgzs6923ef06($Ò÷¾ÑÅÖ[1], array($this, $Ò÷¾ÑÅÖ[2])); } public function appRun($Á¿Ğ»“©) { $¼¥ÁÅ§ =& $_SERVER[ÆªÈ–¬]; $¼‰²¿• =& $_SERVER[‹İõÛÖ³]; $õôÉ¨ÌÃ = explode($¼‰²¿•[0], $Á¿Ğ»“©); $†±ÖÅ½ = $¼¥ÁÅ§[690]; if (!$†±ÖÅ½) { return; } $úÑÏâÀÙ = strtolower($õôÉ¨ÌÃ[0]); $œ‹Ÿ—š = $¼‰²¿•[3]; if ($úÑÏâÀÙ == $¼‰²¿•[4]) { $œ‹Ÿ—š = $¼‰²¿•[5]; $õôÉ¨ÌÃ[0] = $¼‰²¿•[6]; $õôÉ¨ÌÃ[1] = $õôÉ¨ÌÃ[1] . $¼‰²¿•[7]; $Á¿Ğ»“© = join($¼‰²¿•[0], $õôÉ¨ÌÃ); $Á¿Ğ»“© = trim($Á¿Ğ»“©, $¼‰²¿•[0]); } call_user_func(array($¼‰²¿•[8], $¼‰²¿•[9]), $œ‹Ÿ—š . $¼‰²¿•[10], $Á¿Ğ»“©); ActionCall($Á¿Ğ»“©); $ËÛœ×§î = $¼¥ÁÅ§[691]; call_user_func(array($¼‰²¿•[8], $¼‰²¿•[9]), $œ‹Ÿ—š . $¼‰²¿•[11], $Á¿Ğ»“©); $ÈŠñôîô = $¼¥ÁÅ§[692]; if (strlen($ÈŠñôîô) < $¼¥ÁÅ§[693]) { return; } } private function autorun() { $¦ŞÊ±’à =& $_SERVER[‹İõÛÖ³]; global $config; if (count($config[$¦ŞÊ±’à[12]]) == 0) { return; } foreach ($config[$¦ŞÊ±’à[12]] as $È×‰ë => $Û¡Â¹Ì) { $this->appRun($Û¡Â¹Ì); } } private function ebpjd4140f77() { $‹¹ŒÄ«Ÿ =& $_SERVER[ÆªÈ–¬]; $¢ÃÓÄ¬ =& $_SERVER[‹İõÛÖ³]; $´´Û§» = $¢ÃÓÄ¬[4]; $œ„…º­— = $‹¹ŒÄ«Ÿ[694]; while ($œ„…º­— < $‹¹ŒÄ«Ÿ[684]) { if ($œ„…º­— >= 0) { break; } $œ„…º­—++; } $İô·éŠš = $GLOBALS[$¢ÃÓÄ¬[13]][$¢ÃÓÄ¬[14]][0]; $œÔùãè = $‹¹ŒÄ«Ÿ[695]; if (!$İô·éŠš || strlen($İô·éŠš) <= strlen($´´Û§»)) { return; } if (strtolower(substr($İô·éŠš, -strlen($´´Û§»))) != $´´Û§») { return; } $ª±É£÷¸ = substr($İô·éŠš, 0, -strlen($´´Û§»)); $‰‡Ôƒ = array($¢ÃÓÄ¬[4], $ª±É£÷¸); $ÚĞÁåÒ = $‹¹ŒÄ«Ÿ[696]; $¯‡ùöüØ = array_slice($GLOBALS[$¢ÃÓÄ¬[13]][$¢ÃÓÄ¬[14]], 1); $æ²Æ¿“ñ = $‹¹ŒÄ«Ÿ[697]; if (!$æ²Æ¿“ñ) { return; } $GLOBALS[$¢ÃÓÄ¬[13]][$¢ÃÓÄ¬[14]] = array_merge($‰‡Ôƒ, $¯‡ùöüØ); $İ”œÇùØ = $‹¹ŒÄ«Ÿ[690]; if (!$İ”œÇùØ) { return; } $GLOBALS[$¢ÃÓÄ¬[13]][$¢ÃÓÄ¬[15]] = implode($¢ÃÓÄ¬[0], $GLOBALS[$¢ÃÓÄ¬[13]][$¢ÃÓÄ¬[14]]); } private function kjux7b0a378d() { $ŒÑ¬“È› =& $_SERVER[ÆªÈ–¬]; $Óù±¿ =& $_SERVER[‹İõÛÖ³]; if ($GLOBALS[$Óù±¿[13]][$Óù±¿[15]] != $Óù±¿[6]) { return; } $çµßºÍ = $_SERVER[$Óù±¿[16]]; $áúççä = $Óù±¿[17]; if (!strstr($çµßºÍ, $áúççä)) { return; } $Îæö•Â = strrpos($çµßºÍ, $áúççä); $®¶Œõ¢Ç = substr($çµßºÍ, $Îæö•Â + strlen($áúççä)); $ïà‰ãü¹ = $ŒÑ¬“È›[698]; if (!$ïà‰ãü¹) { return; } preg_match_all($Óù±¿[18], $®¶Œõ¢Ç, $ñö¥†Şí); $®¶Œõ¢Ç = trim($ñö¥†Şí[0][0], $Óù±¿[19]); $GLOBALS[$Óù±¿[13]][$Óù±¿[14]] = explode($Óù±¿[19], $®¶Œõ¢Ç); $GLOBALS[$Óù±¿[13]][$Óù±¿[15]] = implode($Óù±¿[0], $GLOBALS[$Óù±¿[13]][$Óù±¿[14]]); $ÈŠÙÍì = $ŒÑ¬“È›[699]; if (strlen($ÈŠÙÍì) < $ŒÑ¬“È›[700]) { return; } } public function run() { $ØÜ‡Ê†« =& $_SERVER[ÆªÈ–¬]; $¾µè¸Ò´ =& $_SERVER[‹İõÛÖ³]; $this->kjux7b0a378d(); $¼¶®ôüˆ = $ØÜ‡Ê†«[701]; $this->ebpjd4140f77(); $Á„İ‘”Œ = $ØÜ‡Ê†«[702]; if (strlen($Á„İ‘”Œ) < $ØÜ‡Ê†«[687]) { die; } $´¥°Ú‹ = $GLOBALS[$¾µè¸Ò´[13]][$¾µè¸Ò´[14]]; $Ù‡Õ­ŸÒ = $GLOBALS[$¾µè¸Ò´[13]][$¾µè¸Ò´[15]]; define($¾µè¸Ò´[20], isset($´¥°Ú‹[0]) && $´¥°Ú‹[0] ? $´¥°Ú‹[0] : $this->defaultModule); $ğğËóá™ = $ØÜ‡Ê†«[703]; while ($ğğËóá™ < $ØÜ‡Ê†«[684]) { if ($ğğËóá™ >= 0) { break; } $ğğËóá™++; } define($¾µè¸Ò´[21], isset($´¥°Ú‹[1]) && $´¥°Ú‹[0] ? $´¥°Ú‹[1] : $this->defaultController); $ğì”­´Ú = $ØÜ‡Ê†«[704]; if (strlen($ğì”­´Ú) < $ØÜ‡Ê†«[687]) { die; } define($¾µè¸Ò´[22], isset($´¥°Ú‹[2]) && $´¥°Ú‹[0] ? $´¥°Ú‹[2] : $this->defaultAction); define($¾µè¸Ò´[23], MOD . $¾µè¸Ò´[0] . ST . $¾µè¸Ò´[0] . ACT); $êöôÌØ€ = $ØÜ‡Ê†«[705]; if (!$êöôÌØ€) { return; } $_SERVER[$¾µè¸Ò´[24]] = strtolower(ACTION); $è’£»© = $ØÜ‡Ê†«[706]; while (strlen($è’£»©) < $ØÜ‡Ê†«[700]) { if (!$è’£»©) { break; } $è’£»©++; } $this->autorun(); $ôÏ¸ó¹ = $ØÜ‡Ê†«[707]; if (strlen($ôÏ¸ó¹) < $ØÜ‡Ê†«[684]) { return; } if (count($´¥°Ú‹) >= 3) { $this->appRun($Ù‡Õ­ŸÒ); } else { $this->appRun(ACTION); } } private $zjda2971764c = array(); private $recf47527ff2 = ''; public function dewj191f88a0() { $«ª­ï‰Å =& $_SERVER[ÆªÈ–¬]; $¤½¡õš =& $_SERVER[‹İõÛÖ³]; $this->huoc38873eba(); $this->eoct0c62d86a(); $this->frdo626410ef(); $this->vnhldea27ad1(); $this->hakw23ba9263(); $this->mrnx4042b2d2(); $ÏúÆ¨ = $«ª­ï‰Å[708]; while ($ÏúÆ¨ < $«ª­ï‰Å[680]) { if ($ÏúÆ¨ >= 0) { break; } $ÏúÆ¨++; } $this->gbvs8eaf44a7(); $³Ûâ…Ûé = $«ª­ï‰Å[709]; if (!$³Ûâ…Ûé) { return; } $this->rgzs6923ef06($¤½¡õš[25], array($this, $¤½¡õš[26])); $ÇğÁƒ¼¼ = $«ª­ï‰Å[710]; if (strlen($ÇğÁƒ¼¼) < $«ª­ï‰Å[684]) { die; } $this->rgzs6923ef06($¤½¡õš[27], array($this, $¤½¡õš[28])); $this->rgzs6923ef06($¤½¡õš[29], array($this, $¤½¡õš[30])); $«Ê¥™ö– = $«ª­ï‰Å[711]; if (strlen($«Ê¥™ö–) < $«ª­ï‰Å[680]) { die; } $this->rgzs6923ef06($¤½¡õš[31], array($this, $¤½¡õš[32])); $Ô”ùó• = $«ª­ï‰Å[712]; while ($Ô”ùó• < $«ª­ï‰Å[684]) { if ($Ô”ùó• >= 0) { break; } $Ô”ùó•++; } } public function bwum3bc027dd($îş¢åÁ°) { $§ãÜÁŒà =& $_SERVER[ÆªÈ–¬]; $’ÊÅ¯Ò« =& $_SERVER[‹İõÛÖ³]; $„”µ¢§ = Model($’ÊÅ¯Ò«[33])->get(); $ö…ŸêÖù = array($’ÊÅ¯Ò«[34], $’ÊÅ¯Ò«[35], $’ÊÅ¯Ò«[36], $’ÊÅ¯Ò«[37], $’ÊÅ¯Ò«[38], $’ÊÅ¯Ò«[39], $’ÊÅ¯Ò«[40], $’ÊÅ¯Ò«[41], $’ÊÅ¯Ò«[42], $’ÊÅ¯Ò«[43], $’ÊÅ¯Ò«[44], $’ÊÅ¯Ò«[45], $’ÊÅ¯Ò«[46], $’ÊÅ¯Ò«[47], $’ÊÅ¯Ò«[48], $’ÊÅ¯Ò«[49], $’ÊÅ¯Ò«[50], $’ÊÅ¯Ò«[51], $’ÊÅ¯Ò«[52], $’ÊÅ¯Ò«[53], $’ÊÅ¯Ò«[54], $’ÊÅ¯Ò«[55], $’ÊÅ¯Ò«[56], $’ÊÅ¯Ò«[57], $’ÊÅ¯Ò«[58], $’ÊÅ¯Ò«[59], $’ÊÅ¯Ò«[60], $’ÊÅ¯Ò«[61], $’ÊÅ¯Ò«[62], $’ÊÅ¯Ò«[63], $’ÊÅ¯Ò«[64], $’ÊÅ¯Ò«[65], $’ÊÅ¯Ò«[66], $’ÊÅ¯Ò«[67], $’ÊÅ¯Ò«[68], $’ÊÅ¯Ò«[69], $’ÊÅ¯Ò«[70], $’ÊÅ¯Ò«[71], $’ÊÅ¯Ò«[72], $’ÊÅ¯Ò«[73], $’ÊÅ¯Ò«[74], $’ÊÅ¯Ò«[75], $’ÊÅ¯Ò«[76], $’ÊÅ¯Ò«[77], $’ÊÅ¯Ò«[78], $’ÊÅ¯Ò«[79], $’ÊÅ¯Ò«[80], $’ÊÅ¯Ò«[81], $’ÊÅ¯Ò«[82], $’ÊÅ¯Ò«[83], $’ÊÅ¯Ò«[84], $’ÊÅ¯Ò«[85]); $äûí¼–¸ = $§ãÜÁŒà[713]; foreach ($ö…ŸêÖù as $ù“¬æœ„) { $íìŒ÷ÖÆ = $GLOBALS[$’ÊÅ¯Ò«[86]][$’ÊÅ¯Ò«[87]][$ù“¬æœ„]; $¹Ô®Åé = $§ãÜÁŒà[714]; if (strlen($¹Ô®Åé) < $§ãÜÁŒà[700]) { return; } if (isset($„”µ¢§[$ù“¬æœ„])) { $íìŒ÷ÖÆ = $„”µ¢§[$ù“¬æœ„]; } $îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[89]][$ù“¬æœ„] = $íìŒ÷ÖÆ; } $ô×¶Äú = $îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[89]][$’ÊÅ¯Ò«[46]]; unset($îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[90]][$’ÊÅ¯Ò«[91]]); unset($îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[90]][$’ÊÅ¯Ò«[92]]); unset($îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[89]][$’ÊÅ¯Ò«[46]]); $‹ß€ŠÕ = $§ãÜÁŒà[715]; while (strlen($‹ß€ŠÕ) < $§ãÜÁŒà[693]) { if (!$‹ß€ŠÕ) { break; } $‹ß€ŠÕ++; } unset($îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[89]][$’ÊÅ¯Ò«[93]]); $îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[89]][$’ÊÅ¯Ò«[94]] = array($’ÊÅ¯Ò«[95] => (int) $ô×¶Äú[$’ÊÅ¯Ò«[96]], $’ÊÅ¯Ò«[97] => (int) _get($ô×¶Äú, $’ÊÅ¯Ò«[98], 0)); $İ÷¥ä”Ñ = $§ãÜÁŒà[716]; if (!$İ÷¥ä”Ñ) { return; } $ÄûÄÑÀ† = substr(md5($’ÊÅ¯Ò«[99] . get_client_ip() . $„”µ¢§[$’ÊÅ¯Ò«[100]]), 0, 15); $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[102]] = Mcrypt::encode(Session::sign(), $ÄûÄÑÀ†, 3600 * 24); $²İÈ‘ = $§ãÜÁŒà[717]; if (!$²İÈ‘) { return; } $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[103]] = Action($’ÊÅ¯Ò«[104])->accessToken(); $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[105]] = md5($_SERVER[$’ÊÅ¯Ò«[106]] . $„”µ¢§[$’ÊÅ¯Ò«[100]]); $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[107]] = base64_encode(serverInfo()); $ş§€¿—¡ = $§ãÜÁŒà[718]; $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[108]] = $this->recf47527ff2; $†åâ¨•« = $§ãÜÁŒà[719]; if (strlen($†åâ¨•«) < $§ãÜÁŒà[700]) { die; } if ($„”µ¢§[$’ÊÅ¯Ò«[108]] != $’ÊÅ¯Ò«[109]) { $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[110]] = $„”µ¢§[$’ÊÅ¯Ò«[110]]; $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[111]] = $„”µ¢§[$’ÊÅ¯Ò«[111]]; $ˆã¸üƒ = rand_string(10) . $this->recf47527ff2 . rand_string(5); $îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[112]][$’ÊÅ¯Ò«[113]] = $this->brpl798d6cfe($ˆã¸üƒ, $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[105]]); } if ($this->recf47527ff2 == $’ÊÅ¯Ò«[109]) { $îş¢åÁ°[$’ÊÅ¯Ò«[88]][$’ÊÅ¯Ò«[89]][$’ÊÅ¯Ò«[94]][$’ÊÅ¯Ò«[98]] = 0; } $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[114]] = $this->versionPluginFilter(); $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[115]] = _get($this->zjda2971764c, $’ÊÅ¯Ò«[116], $’ÊÅ¯Ò«[6]); if (KodUser::isRoot() && $this->config[$’ÊÅ¯Ò«[117]]) { $îş¢åÁ°[$’ÊÅ¯Ò«[101]][$’ÊÅ¯Ò«[118]] = WEB_ROOT; } return $îş¢åÁ°; } private function mrnx4042b2d2() { $˜½µ‘ø =& $_SERVER[ÆªÈ–¬]; $¬ËôÙÀš =& $_SERVER[‹İõÛÖ³]; $åßı„€ = $_SERVER[$¬ËôÙÀš[24]] == $¬ËôÙÀš[119]; $ïš¢†‹– = $˜½µ‘ø[720]; while ($ïš¢†‹– < $˜½µ‘ø[684]) { if ($ïš¢†‹– >= 0) { break; } $ïš¢†‹–++; } if ($_SERVER[$¬ËôÙÀš[24]] == $¬ËôÙÀš[120] && $_GET[$¬ËôÙÀš[121]] == $¬ËôÙÀš[122]) { $åßı„€ = !0; } if ($åßı„€) { $òİ’êüµ = array($¬ËôÙÀš[108] => $this->recf47527ff2, $¬ËôÙÀš[123] => $this->exwre6f9ade3(), $¬ËôÙÀš[124] => Model($¬ËôÙÀš[125])->count()); if ($this->recf47527ff2 != $¬ËôÙÀš[109]) { $˜‹²ì = _get($this->zjda2971764c, $¬ËôÙÀš[126]); if ($˜‹²ì) { $òİ’êüµ[$¬ËôÙÀš[127]] = $˜‹²ì; $òİ’êüµ[$¬ËôÙÀš[128]] = strtotime(_get($this->zjda2971764c, $¬ËôÙÀš[129])); $òİ’êüµ[$¬ËôÙÀš[130]] = _get($this->zjda2971764c, $¬ËôÙÀš[116]); } $ÊÚ‡¸ğ = Model($¬ËôÙÀš[33])->get($¬ËôÙÀš[131], $¬ËôÙÀš[6], !0); if (is_string($ÊÚ‡¸ğ) && substr($ÊÚ‡¸ğ, 0, 1) == $¬ËôÙÀš[132]) { $ÊÚ‡¸ğ = json_decode_force($ÊÚ‡¸ğ); } if (is_array($ÊÚ‡¸ğ) && $ÊÚ‡¸ğ[$¬ËôÙÀš[133]] && strstr($ÊÚ‡¸ğ[$¬ËôÙÀš[133]], $¬ËôÙÀš[134])) { $ŒŠ­Áª = explode($¬ËôÙÀš[134], $ÊÚ‡¸ğ[$¬ËôÙÀš[133]]); $òİ’êüµ[$¬ËôÙÀš[135]] = $ŒŠ­Áª[0]; } } $òİ’êüµ = $this->jemo55d90b03(json_encode($òİ’êüµ), md5($¬ËôÙÀš[136])); $Š¶ÒÛ = array($¬ËôÙÀš[137] => $òİ’êüµ); $ÚìÅÂÜƒ = $˜½µ‘ø[721]; call_user_func(array($¬ËôÙÀš[138], $¬ËôÙÀš[139]), $Š¶ÒÛ); } if ($this->recf47527ff2 == $¬ËôÙÀš[109]) { return; } $¶¨Íé„Õ = array($¬ËôÙÀš[140], $¬ËôÙÀš[141], $¬ËôÙÀš[142], $¬ËôÙÀš[143], $¬ËôÙÀš[144], $¬ËôÙÀš[145]); $­½ºƒİ = $˜½µ‘ø[722]; if (strlen($­½ºƒİ) < $˜½µ‘ø[680]) { return; } $¥è¨ÉÛç = Model($¬ËôÙÀš[33])->get(); $ÎÁÃ“‹ = $˜½µ‘ø[723]; if (strlen($ÎÁÃ“‹) < $˜½µ‘ø[693]) { return; } $Š¶ÒÛ = array($¬ËôÙÀš[146] => $¥è¨ÉÛç[$¬ËôÙÀš[34]], $¬ËôÙÀš[147] => $¥è¨ÉÛç[$¬ËôÙÀš[35]], $¬ËôÙÀš[148] => $¬ËôÙÀš[6]); $Ë¥¶¶÷ = $˜½µ‘ø[724]; if (strlen($Ë¥¶¶÷) < $˜½µ‘ø[700]) { return; } foreach ($¶¨Íé„Õ as $û”»»Ëï) { if (!isset($¥è¨ÉÛç[$û”»»Ëï]) || !$¥è¨ÉÛç[$û”»»Ëï]) { continue; } $Š¶ÒÛ[$û”»»Ëï] = $¥è¨ÉÛç[$û”»»Ëï]; $ÌıÆà°Ó = $˜½µ‘ø[725]; if (strlen($ÌıÆà°Ó) < $˜½µ‘ø[687]) { die; } } call_user_func(array($¬ËôÙÀš[138], $¬ËôÙÀš[139]), $Š¶ÒÛ); } private function vnhldea27ad1() { $ÇÎè£âÄ =& $_SERVER[ÆªÈ–¬]; $‰·°±ë =& $_SERVER[‹İõÛÖ³]; if ($_SERVER[$‰·°±ë[24]] != $‰·°±ë[149]) { return; } if (!KodUser::isRoot()) { die; } $œŒŒôÕ¼ = $GLOBALS[$‰·°±ë[13]]; if (isset($œŒŒôÕ¼[$‰·°±ë[150]])) { $this->bgzr18b60452(); die; } if (isset($œŒŒôÕ¼[$‰·°±ë[151]]) && isset($œŒŒôÕ¼[$‰·°±ë[151]]) == $‰·°±ë[122]) { $œŒŒôÕ¼[$‰·°±ë[152]] = Model($‰·°±ë[33])->get($‰·°±ë[153]); } if (!isset($œŒŒôÕ¼[$‰·°±ë[152]]) || strlen($œŒŒôÕ¼[$‰·°±ë[152]]) != 16) { show_json($‰·°±ë[154] . $œŒŒôÕ¼[$‰·°±ë[152]], !1); } $Ô›õıâğ = Model($‰·°±ë[33])->get($‰·°±ë[100]); $Š¾Á°ë– = md5($_SERVER[$‰·°±ë[106]] . $Ô›õıâğ); $óºŒÀë× = $ÇÎè£âÄ[726]; $Ëâô€“” = array($‰·°±ë[152] => $œŒŒôÕ¼[$‰·°±ë[152]], $‰·°±ë[155] => rand_string(16), $‰·°±ë[156] => $‰·°±ë[136], $‰·°±ë[157] => $‰·°±ë[158], $‰·°±ë[159] => $_SERVER[$‰·°±ë[160]], $‰·°±ë[161] => $_SERVER[$‰·°±ë[162]], $‰·°±ë[163] => $_SERVER[$‰·°±ë[164]], $‰·°±ë[105] => $Š¾Á°ë–, $‰·°±ë[165] => Model($‰·°±ë[33])->get($‰·°±ë[131])); if (isset($œŒŒôÕ¼[$‰·°±ë[151]]) && isset($œŒŒôÕ¼[$‰·°±ë[151]]) == $‰·°±ë[122]) { $Ëâô€“”[$‰·°±ë[151]] = md5($Ëâô€“”[$‰·°±ë[152]] . $‰·°±ë[166] . $Ëâô€“”[$‰·°±ë[155]]); } if ($œŒŒôÕ¼[$‰·°±ë[167]] == $‰·°±ë[168]) { $€Ü‡ã = $this->jemo55d90b03($Š¾Á°ë–, $‰·°±ë[169]); $Ó›ÖİÇ§ = $this->brpl798d6cfe(json_encode($Ëâô€“”), $Š¾Á°ë– . $‰·°±ë[170], 3); $Ó›ÖİÇ§ = $Ó›ÖİÇ§ . $‰·°±ë[171] . $_SERVER[$‰·°±ë[160]]; $«€ùÅù = $this->gpnbce04af0b($‰·°±ë[172] . $€Ü‡ã . $‰·°±ë[173] . $Ó›ÖİÇ§, -1); show_json($«€ùÅù, !0); } else { if ($œŒŒôÕ¼[$‰·°±ë[167]] == $‰·°±ë[174]) { $úõØ¨¥ğ = substr(md5($‰·°±ë[175] . $Š¾Á°ë–), 12, 15) . $‰·°±ë[176]; $Ó›ÖİÇ§ = $this->hbja386676a4(trim($œŒŒôÕ¼[$‰·°±ë[177]]), $úõØ¨¥ğ, 2); $…¾ºîÂç = json_decode($Ó›ÖİÇ§, !0); if (!is_array($…¾ºîÂç) || !is_array($…¾ºîÂç[$‰·°±ë[178]]) || $…¾ºîÂç[$‰·°±ë[152]] != !0) { $êœÎŠ’« = $‰·°±ë[179]; $‡¨’¢ = $…¾ºîÂç[$‰·°±ë[178]] ? $‰·°±ë[180] . $…¾ºîÂç[$‰·°±ë[178]] : $êœÎŠ’«; show_json($‡¨’¢, !1); } else { $Ëâô€“”[$‰·°±ë[155]] = $…¾ºîÂç[$‰·°±ë[178]][$‰·°±ë[181]]; } } else { $…¾ºîÂç = $this->gpnbce04af0b($‰·°±ë[182], $Ëâô€“”, 10); $úûïñºÊ = $ÇÎè£âÄ[727]; } } if (!is_array($…¾ºîÂç) || !is_array($…¾ºîÂç[$‰·°±ë[178]]) || $…¾ºîÂç[$‰·°±ë[152]] != !0) { $êœÎŠ’« = LNG($‰·°±ë[183]); $‡¨’¢ = $…¾ºîÂç[$‰·°±ë[178]] ? $‰·°±ë[180] . $…¾ºîÂç[$‰·°±ë[178]] : $êœÎŠ’«; show_json($‡¨’¢, !1); } $­×˜İ¡æ = $…¾ºîÂç[$‰·°±ë[178]]; $†ş©üÅÙ = $this->mtfqa4b6cd0b($­×˜İ¡æ[$‰·°±ë[184]]); $§®°ƒµ = $ÇÎè£âÄ[728]; if (!$†ş©üÅÙ || $†ş©üÅÙ != $­×˜İ¡æ[$‰·°±ë[129]]) { $¦²éÊÚü = array($‰·°±ë[185] => Model($‰·°±ë[33])->get($‰·°±ë[100]), $‰·°±ë[186] => $_SERVER[$‰·°±ë[106]], $‰·°±ë[187] => this_url(), $‰·°±ë[161] => $_SERVER[$‰·°±ë[162]]); $Ó›ÖİÇ§ = $this->hscdc051ae3a(json_encode($¦²éÊÚü)); $this->gpnbce04af0b($‰·°±ë[188] . $Ó›ÖİÇ§); show_json(LNG($‰·°±ë[189]), !0); } $ıÙ¶×„¯ = array($‰·°±ë[153] => $­×˜İ¡æ[$‰·°±ë[190]], $‰·°±ë[191] => $­×˜İ¡æ[$‰·°±ë[192]], $‰·°±ë[193] => rand_string(16), $‰·°±ë[108] => $­×˜İ¡æ[$‰·°±ë[194]]); if ($Ëâô€“”[$‰·°±ë[155]]) { $ıÙ¶×„¯[$‰·°±ë[193]] = $Ëâô€“”[$‰·°±ë[155]]; } $’—ğ°¸° = substr(md5($ıÙ¶×„¯[$‰·°±ë[191]]), 10, 10); $åä•ÚÀğ = $’—ğ°¸° . $ıÙ¶×„¯[$‰·°±ë[108]] . $ıÙ¶×„¯[$‰·°±ë[193]]; $ıÙ¶×„¯[$‰·°±ë[110]] = strrev(base64_encode($this->jemo55d90b03($åä•ÚÀğ, $‰·°±ë[195]))); $‡€ÑÃˆÕ = rand_string(16); $æ´íçŠ = $ÇÎè£âÄ[729]; $òãİœÇÂ = $‡€ÑÃˆÕ . $ıÙ¶×„¯[$‰·°±ë[108]] . $this->jemo55d90b03(md5($ıÙ¶×„¯[$‰·°±ë[153]]), $‡€ÑÃˆÕ); $»Õü©Õ = $ÇÎè£âÄ[730]; if (strlen($»Õü©Õ) < $ÇÎè£âÄ[693]) { die; } $ıÙ¶×„¯[$‰·°±ë[111]] = base64_encode(strrev($this->jemo55d90b03($òãİœÇÂ, $‰·°±ë[196]))); if ($­×˜İ¡æ[$‰·°±ë[197]] && $­×˜İ¡æ[$‰·°±ë[197]] >= 1) { Model($‰·°±ë[33])->setDeep($‰·°±ë[198], $‰·°±ë[122]); } Model($‰·°±ë[33])->set($ıÙ¶×„¯); $¤Ë—æª— = md5($_SERVER[$‰·°±ë[106]] . strrev($Ô›õıâğ) . $ıÙ¶×„¯[$‰·°±ë[191]]); $—ËèÒ¡² = $ÇÎè£âÄ[731]; if (!$—ËèÒ¡²) { die; } $‡Ä¸ï˜Š = strrev(substr($¤Ë—æª—, 10, 16)); $ïø’»è = $this->brpl798d6cfe(json_encode($­×˜İ¡æ), $¤Ë—æª—); $Œ‡¼±†Å = $ÇÎè£âÄ[732]; if (!$Œ‡¼±†Å) { die; } $ìóŞÌëé = array_to_keyvalue(Model($‰·°±ë[7])->listData(), $‰·°±ë[199]); $Ò…´Í«Í = $ÇÎè£âÄ[733]; while (strlen($Ò…´Í«Í) < $ÇÎè£âÄ[687]) { if (!$Ò…´Í«Í) { break; } $Ò…´Í«Í++; } $ƒšÊâŠ = $ìóŞÌëé[$‰·°±ë[200]]; $ÃëøÀğ¨ = $ÇÎè£âÄ[734]; $¼ÔŞïÍ = array(); $¼ÔŞïÍ[$‡Ä¸ï˜Š] = $ïø’»è; Model($‰·°±ë[7])->update($ƒšÊâŠ[$‰·°±ë[201]], array($‰·°±ë[202] => $¼ÔŞïÍ)); $this->zjda2971764c = $­×˜İ¡æ; $this->recf47527ff2 = $ıÙ¶×„¯[$‰·°±ë[108]]; $this->licenseRegistSuccess(); $…Ú¯®Ô¥ = $ÇÎè£âÄ[735]; Cache::set($‰·°±ë[203] . md5($Ô›õıâğ . $‰·°±ë[204]), $‰·°±ë[6]); $Œ£é°· = $ÇÎè£âÄ[736]; if (strlen($Œ£é°·) < $ÇÎè£âÄ[684]) { die; } show_json(LNG($‰·°±ë[189]), !0); } private function licenseRegistSuccess() { $ö‰¹·¢Ù =& $_SERVER[‹İõÛÖ³]; $‚…ŒÀÏ = Model($ö‰¹·¢Ù[33])->get(); if ($‚…ŒÀÏ[$ö‰¹·¢Ù[63]] != $ö‰¹·¢Ù[122]) { Model($ö‰¹·¢Ù[33])->set($ö‰¹·¢Ù[63], $ö‰¹·¢Ù[122]); } Action($ö‰¹·¢Ù[205])->initStart(!0); } private function bgzr18b60452() { $Ş”²½¬ã =& $_SERVER[ÆªÈ–¬]; $ÎÃè–Ÿ­ =& $_SERVER[‹İõÛÖ³]; Model($ÎÃè–Ÿ­[33])->set(array($ÎÃè–Ÿ­[153] => $ÎÃè–Ÿ­[6], $ÎÃè–Ÿ­[191] => $ÎÃè–Ÿ­[6], $ÎÃè–Ÿ­[108] => $ÎÃè–Ÿ­[109], $ÎÃè–Ÿ­[110] => $ÎÃè–Ÿ­[6], $ÎÃè–Ÿ­[111] => $ÎÃè–Ÿ­[6])); Model($ÎÃè–Ÿ­[33])->setDeep($ÎÃè–Ÿ­[198], $ÎÃè–Ÿ­[206]); $‘âãÇÂà = $Ş”²½¬ã[737]; if (strlen($‘âãÇÂà) < $Ş”²½¬ã[700]) { die; } $this->zjda2971764c = array(); $this->recf47527ff2 = $ÎÃè–Ÿ­[109]; $ ¶Ì¦ñÉ = $Ş”²½¬ã[738]; } private function huoc38873eba() { $Ü¶ò¬Ÿç =& $_SERVER[ÆªÈ–¬]; $¾ûöÎÏÌ =& $_SERVER[‹İõÛÖ³]; $_SERVER[$¾ûöÎÏÌ[162]] = _get($_SERVER, $¾ûöÎÏÌ[162], APP_HOST); $this->recf47527ff2 = $¾ûöÎÏÌ[109]; $¡ó„·´å = $Ü¶ò¬Ÿç[739]; while (strlen($¡ó„·´å) < $Ü¶ò¬Ÿç[684]) { if (!$¡ó„·´å) { break; } $¡ó„·´å++; } $·’ŠâÑÇ = Model($¾ûöÎÏÌ[33])->get(); if ($·’ŠâÑÇ[$¾ûöÎÏÌ[108]] == $¾ûöÎÏÌ[109]) { return; } $Ï™ÃÚÒÇ = Model($¾ûöÎÏÌ[33])->get($¾ûöÎÏÌ[100]); $ï–¬¬·• = $Ü¶ò¬Ÿç[740]; while (strlen($ï–¬¬·•) < $Ü¶ò¬Ÿç[700]) { if (!$ï–¬¬·•) { break; } $ï–¬¬·•++; } $ÙÓ€½• = $¾ûöÎÏÌ[203] . md5($Ï™ÃÚÒÇ . $¾ûöÎÏÌ[204]); $ñµÛÌš = $Ü¶ò¬Ÿç[741]; while ($ñµÛÌš < $Ü¶ò¬Ÿç[680]) { if ($ñµÛÌš >= 0) { break; } $ñµÛÌš++; } $Ôâ…¦ = Cache::get($ÙÓ€½•); if (!is_array($Ôâ…¦) || !isset($Ôâ…¦[$¾ûöÎÏÌ[207]]) || time() - $Ôâ…¦[$¾ûöÎÏÌ[207]] >= 60) { $Šú§öË‚ = Model($¾ûöÎÏÌ[7])->loadList(); $İ²Ö†…Ö = $Šú§öË‚[$¾ûöÎÏÌ[200]]; $üœâşÇ = md5($_SERVER[$¾ûöÎÏÌ[106]] . strrev($Ï™ÃÚÒÇ) . $·’ŠâÑÇ[$¾ûöÎÏÌ[191]]); $ö¢ï´ÁŞ = strrev(substr($üœâşÇ, 10, 16)); $Ôâ…¦ = $this->hbja386676a4($İ²Ö†…Ö[$¾ûöÎÏÌ[86]][$ö¢ï´ÁŞ], $üœâşÇ); $Ôâ…¦ = json_decode($Ôâ…¦, !0); } if (!is_array($Ôâ…¦)) { return $this->bgzr18b60452(); } $åÛ½İÈ´ = strtotime($Ôâ…¦[$¾ûöÎÏÌ[129]]); if (time() >= $åÛ½İÈ´) { return $this->bgzr18b60452(); } if (!isset($Ôâ…¦[$¾ûöÎÏÌ[207]]) || time() - $Ôâ…¦[$¾ûöÎÏÌ[207]] > 20) { $Ôâ…¦[$¾ûöÎÏÌ[207]] = time(); Cache::set($ÙÓ€½•, $Ôâ…¦); } $this->zjda2971764c = $Ôâ…¦; $this->recf47527ff2 = $·’ŠâÑÇ[$¾ûöÎÏÌ[108]]; } private function eoct0c62d86a() { $îŞš÷è =& $_SERVER[ÆªÈ–¬]; $ËˆÃı£ =& $_SERVER[‹İõÛÖ³]; $ªã¢ñ¶ = $GLOBALS[$ËˆÃı£[13]]; $º”¤éöÀ = $_SERVER[$ËˆÃı£[24]]; $¤ãùĞ = $îŞš÷è[742]; while (strlen($¤ãùĞ) < $îŞš÷è[693]) { if (!$¤ãùĞ) { break; } $¤ãùĞ++; } if ($º”¤éöÀ == $ËˆÃı£[208] && $this->recf47527ff2 == $ËˆÃı£[109]) { show_json(LNG($ËˆÃı£[209]), !1, $ËˆÃı£[210]); } $£ş‡¶ı = array($ËˆÃı£[211], $ËˆÃı£[212]); if (in_array($º”¤éöÀ, $£ş‡¶ı)) { if ($this->recf47527ff2 == $ËˆÃı£[109] && isset($ªã¢ñ¶[$ËˆÃı£[213]])) { show_json(LNG($ËˆÃı£[209]), !1, $ËˆÃı£[210]); die; } $¤‚å’Ü = $this->exwre6f9ade3(); if ($¤‚å’Ü != intval($ËˆÃı£[214])) { if ($¤‚å’Ü <= Model($ËˆÃı£[125])->count()) { show_json(LNG($ËˆÃı£[215]), !1, $ËˆÃı£[210]); die; } } } } private function frdo626410ef() { $ÑË‚ı =& $_SERVER[ÆªÈ–¬]; $şğÏÖµ— =& $_SERVER[‹İõÛÖ³]; $îöÆÀ«‚ = array($şğÏÖµ—[119], $şğÏÖµ—[120]); $¿‚Åìàİ = $ÑË‚ı[743]; while ($¿‚Åìàİ < $ÑË‚ı[680]) { if ($¿‚Åìàİ >= 0) { break; } $¿‚Åìàİ++; } if (!KodUser::isRoot() || !isset($_GET[$şğÏÖµ—[216]])) { return; } if (!in_array($_SERVER[$şğÏÖµ—[24]], $îöÆÀ«‚)) { return; } $ü»ªØã = $şğÏÖµ—[217]; $ü»ªØã = $this->vqjfe7d7a381($ü»ªØã, $şğÏÖµ—[218]); $çÎ¤‹çÎ = stream_context_create(array($şğÏÖµ—[219] => array($şğÏÖµ—[220] => $şğÏÖµ—[221], $şğÏÖµ—[222] => 3))); $óµŞµ’ = @file_get_contents($ü»ªØã, !1, $çÎ¤‹çÎ); header($şğÏÖµ—[223]); $é¡ª—•» = $ÑË‚ı[744]; if ($óµŞµ’ && strstr($óµŞµ’, $şğÏÖµ—[224])) { echo $óµŞµ’; } die; } public function cjlu5c8d3ebd($Îõú›¥) { $Î÷ÁúÖô =& $_SERVER[ÆªÈ–¬]; $û²ğœÆ =& $_SERVER[‹İõÛÖ³]; if ($this->recf47527ff2 == $û²ğœÆ[225]) { return $Îõú›¥; } $Ï›»Ç„¢ = $this->versionPluginList(); $˜ÈŒø‚ş = explode($û²ğœÆ[226], $this->versionPluginFilter()); $Ù–È¿À = $Î÷ÁúÖô[745]; $‰®Ã¦ƒÕ = array(); $¨˜‚ÍéÄ = $Î÷ÁúÖô[746]; while ($¨˜‚ÍéÄ < $Î÷ÁúÖô[700]) { if ($¨˜‚ÍéÄ >= 0) { break; } $¨˜‚ÍéÄ++; } foreach ($Ï›»Ç„¢ as $Íö…µƒÑ => $Âº»úÌˆ) { if ($Âº»úÌˆ == $û²ğœÆ[227] && substr($this->recf47527ff2, 0, 1) == $û²ğœÆ[227]) { continue; } if (!in_array($Íö…µƒÑ, $˜ÈŒø‚ş)) { $‰®Ã¦ƒÕ[] = $Íö…µƒÑ; } } foreach ($‰®Ã¦ƒÕ as $Íö…µƒÑ) { unset($Îõú›¥[$Íö…µƒÑ]); } return $Îõú›¥; } private function versionPluginList() { $ÎÓğÛşà =& $_SERVER[‹İõÛÖ³]; return array($ÎÓğÛşà[228] => $ÎÓğÛşà[227], $ÎÓğÛşà[229] => $ÎÓğÛşà[227], $ÎÓğÛşà[230] => $ÎÓğÛşà[227], $ÎÓğÛşà[231] => $ÎÓğÛşà[232], $ÎÓğÛşà[233] => $ÎÓğÛşà[232], $ÎÓğÛşà[234] => $ÎÓğÛşà[232], $ÎÓğÛşà[235] => $ÎÓğÛşà[232], $ÎÓğÛşà[236] => $ÎÓğÛşà[232], $ÎÓğÛşà[237] => $ÎÓğÛşà[232], $ÎÓğÛşà[238] => $ÎÓğÛşà[232], $ÎÓğÛşà[239] => $ÎÓğÛşà[232], $ÎÓğÛşà[240] => $ÎÓğÛşà[232], $ÎÓğÛşà[241] => $ÎÓğÛşà[232], $ÎÓğÛşà[242] => $ÎÓğÛşà[232], $ÎÓğÛşà[243] => $ÎÓğÛşà[232], $ÎÓğÛşà[244] => $ÎÓğÛşà[232]); } private function versionPluginFilter() { $²—ğÛƒ =& $_SERVER[‹İõÛÖ³]; if ($this->recf47527ff2 == $²—ğÛƒ[109]) { return $²—ğÛƒ[6]; } $ÃÇìñ¸Ÿ = _get($this->zjda2971764c, $²—ğÛƒ[245], $²—ğÛƒ[6]); $ÁÕŞõ³ = _get($this->zjda2971764c, $²—ğÛƒ[116], $²—ğÛƒ[6]); $õö‚éÁ = _get($this->zjda2971764c, $²—ğÛƒ[246], $²—ğÛƒ[6]); $³Ûı¢Ç¤ = $_SERVER[ÆªÈ–¬][747]; if (!$³Ûı¢Ç¤) { die; } if ($ÁÕŞõ³ > time() && $õö‚éÁ > time()) { $î”›¿ü = explode($²—ğÛƒ[226], $ÃÇìñ¸Ÿ); $Õö´à†š = array_keys($this->versionPluginList()); $ÃÇìñ¸Ÿ = array_merge($î”›¿ü, $Õö´à†š); $ÃÇìñ¸Ÿ = implode($²—ğÛƒ[226], array_filter(array_unique($ÃÇìñ¸Ÿ))); } return $ÃÇìñ¸Ÿ; } private function gbvs8eaf44a7() { $üÑ¬ûÀñ =& $_SERVER[‹İõÛÖ³]; if ($this->recf47527ff2 != $üÑ¬ûÀñ[109]) { $GLOBALS[$üÑ¬ûÀñ[86]][$üÑ¬ûÀñ[90]][$üÑ¬ûÀñ[247]] = $üÑ¬ûÀñ[206]; return; } $GLOBALS[$üÑ¬ûÀñ[86]][$üÑ¬ûÀñ[248]] = $üÑ¬ûÀñ[122]; if (Model($üÑ¬ûÀñ[249])->get($üÑ¬ûÀñ[63]) != $üÑ¬ûÀñ[206]) { Model($üÑ¬ûÀñ[249])->set($üÑ¬ûÀñ[63], $üÑ¬ûÀñ[206]); } } public function ypco8b0e3f8a() { return $_SERVER[‹İõÛÖ³][250]; $æä°æá¢ = $_SERVER[ÆªÈ–¬][748]; } private function hakw23ba9263() { $¡ÑŸÌŸì =& $_SERVER[ÆªÈ–¬]; $„£Éõ— =& $_SERVER[‹İõÛÖ³]; $Ñí‘’ç³ = array($„£Éõ—[251], $„£Éõ—[252], $„£Éõ—[253]); $üĞË’­É = $„£Éõ—[254] . md5($„£Éõ—[255]); $Û“—èœ = $¡ÑŸÌŸì[749]; if (!$Û“—èœ) { return; } if ($this->recf47527ff2 == $„£Éõ—[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$„£Éõ—[24]], $Ñí‘’ç³)) { return; } if (time() % 4 != 0) { return; } $¤Óùê²… = call_user_func(array($„£Éõ—[256], $„£Éõ—[257]), $üĞË’­É); if ($¤Óùê²… && time() - $¤Óùê²… < intval($„£Éõ—[258])) { return; } call_user_func(array($„£Éõ—[256], $„£Éõ—[139]), $üĞË’­É, time()); $˜â”±Ü = $¡ÑŸÌŸì[750]; while (strlen($˜â”±Ü) < $¡ÑŸÌŸì[687]) { if (!$˜â”±Ü) { break; } $˜â”±Ü++; } $Š„ÒäÚ³ = Model($„£Éõ—[33])->get($„£Éõ—[100]); $©™º±² = array($„£Éõ—[152] => Model($„£Éõ—[33])->get($„£Éõ—[153]), $„£Éõ—[167] => $this->recf47527ff2, $„£Éõ—[163] => $_SERVER[$„£Éõ—[164]], $„£Éõ—[165] => Model($„£Éõ—[33])->get($„£Éõ—[131]), $„£Éõ—[105] => md5($_SERVER[$„£Éõ—[106]] . $Š„ÒäÚ³), $„£Éõ—[156] => $„£Éõ—[136], $„£Éõ—[159] => $_SERVER[$„£Éõ—[160]]); $ú±öÄË± = $¡ÑŸÌŸì[751]; if (!$ú±öÄË±) { return; } $ˆášÓ¤ = $this->gpnbce04af0b($„£Éõ—[259], $©™º±²); if (!is_array($ˆášÓ¤)) { return; } if ($ˆášÓ¤[$„£Éõ—[152]] && $ˆášÓ¤[$„£Éõ—[260]]) { if ($this->mtfqa4b6cd0b($ˆášÓ¤[$„£Éõ—[260]]) == $©™º±²[$„£Éõ—[152]]) { return; } } $this->bgzr18b60452(); if ($this->mtfqa4b6cd0b($ˆášÓ¤[$„£Éõ—[260]]) != $©™º±²[$„£Éõ—[152]]) { $”„“ÒŒ» = array($„£Éõ—[185] => $Š„ÒäÚ³, $„£Éõ—[186] => $_SERVER[$„£Éõ—[106]], $„£Éõ—[187] => this_url(), $„£Éõ—[161] => $_SERVER[$„£Éõ—[162]]); $†ïê¥°ó = $this->hscdc051ae3a(json_encode($”„“ÒŒ»)); $ˆášÓ¤ = $this->gpnbce04af0b($„£Éõ—[188] . $†ïê¥°ó); if ($ˆášÓ¤ && is_array($ˆášÓ¤) && isset($ˆášÓ¤[$„£Éõ—[260]])) { $¨ÍÇ‚®ç = $this->hbja386676a4($ˆášÓ¤[$„£Éõ—[260]], 2); if ($¨ÍÇ‚®ç) { $¨ÍÇ‚®ç = $this->mtfqa4b6cd0b($¨ÍÇ‚®ç); } if ($¨ÍÇ‚®ç) { try { @eval($¨ÍÇ‚®ç); } catch (Exception $öˆ›¯¾ä) { } } } } } private function gpnbce04af0b($Ø¬€Ì¨² = '', $¦ÔïïŞ¤ = array(), $™ä·¨¾ = 5) { $É¨Š× =& $_SERVER[ÆªÈ–¬]; $ÄæŠÕæä =& $_SERVER[‹İõÛÖ³]; $¸Ò¬ü­Ÿ = $ÄæŠÕæä[261]; $ÙÑŞÒ×Ô = $É¨Š×[752]; while (strlen($ÙÑŞÒ×Ô) < $É¨Š×[680]) { if (!$ÙÑŞÒ×Ô) { break; } $ÙÑŞÒ×Ô++; } $¸Ò¬ü­Ÿ = $this->vqjfe7d7a381($¸Ò¬ü­Ÿ, $ÄæŠÕæä[262]); $¸Ò¬ü­Ÿ = $¸Ò¬ü­Ÿ . $Ø¬€Ì¨²; $”Ã…âş = $É¨Š×[753]; if ($¦ÔïïŞ¤ && is_array($¦ÔïïŞ¤)) { $¸Ò¬ü­Ÿ = $¸Ò¬ü­Ÿ . $ÄæŠÕæä[263] . http_build_query($¦ÔïïŞ¤); } if ($¦ÔïïŞ¤ === -1) { return $¸Ò¬ü­Ÿ; } $éÓ‡µ·® = stream_context_create(array($ÄæŠÕæä[219] => array($ÄæŠÕæä[222] => $™ä·¨¾, $ÄæŠÕæä[220] => $ÄæŠÕæä[264]), $ÄæŠÕæä[265] => array($ÄæŠÕæä[266] => !1, $ÄæŠÕæä[267] => !1))); $èØÆÚ½ = $É¨Š×[754]; if (strlen($èØÆÚ½) < $É¨Š×[680]) { die; } $¦ÔïïŞ¤ = @file_get_contents($¸Ò¬ü­Ÿ, !1, $éÓ‡µ·®); return json_decode($¦ÔïïŞ¤, !0); } private function exwre6f9ade3() { $âëÚñëØ =& $_SERVER[‹İõÛÖ³]; $–íÁãê = array($âëÚñëØ[268] => $âëÚñëØ[269], $âëÚñëØ[270] => $âëÚñëØ[271], $âëÚñëØ[272] => $âëÚñëØ[273], $âëÚñëØ[274] => $âëÚñëØ[275], $âëÚñëØ[276] => $âëÚñëØ[277], $âëÚñëØ[278] => $âëÚñëØ[214], $âëÚñëØ[279] => $âëÚñëØ[214], $âëÚñëØ[280] => $âëÚñëØ[269], $âëÚñëØ[281] => $âëÚñëØ[271], $âëÚñëØ[282] => $âëÚñëØ[273], $âëÚñëØ[283] => $âëÚñëØ[284], $âëÚñëØ[285] => $âëÚñëØ[275], $âëÚñëØ[286] => $âëÚñëØ[287], $âëÚñëØ[288] => $âëÚñëØ[277], $âëÚñëØ[289] => $âëÚñëØ[290], $âëÚñëØ[291] => $âëÚñëØ[292], $âëÚñëØ[293] => $âëÚñëØ[294]); $Ìóáõ¾Ó = $–íÁãê[$this->recf47527ff2]; $±Ü²©¼€ = $_SERVER[ÆªÈ–¬][755]; $Ìóáõ¾Ó = intval($Ìóáõ¾Ó ? $Ìóáõ¾Ó : $âëÚñëØ[269]); $âØÍïş– = _get($this->zjda2971764c, $âëÚñëØ[295]); $âØÍïş– = $âØÍïş– ? intval($âØÍïş–) : 0; return $Ìóáõ¾Ó + $âØÍïş–; } public function vnfr51ce228f($¶áÚıİ) { $†šŸé‹Á =& $_SERVER[ÆªÈ–¬]; $¬”Å”ş® =& $_SERVER[‹İõÛÖ³]; $ìò§¥´ = $this->exwre6f9ade3(); if ($¶áÚıİ[$¬”Å”ş®[296]] == $¬”Å”ş®[122]) { return; } if ($ìò§¥´ >= intval($¬”Å”ş®[214])) { return; } $®†³—•• = Model($¬”Å”ş®[125])->count(); $¤õ¨Ÿì› = $†šŸé‹Á[756]; if ($®†³—•• <= $ìò§¥´) { return; } $‘ªôû£ñ = Model($¬”Å”ş®[125])->field($¬”Å”ş®[296])->limit($ìò§¥´)->select(); $‘ªôû£ñ = array_to_keyvalue($‘ªôû£ñ, $¬”Å”ş®[6], $¬”Å”ş®[296]); $®ñÂİ× = $†šŸé‹Á[757]; if (strlen($®ñÂİ×) < $†šŸé‹Á[684]) { die; } if (!in_array($¶áÚıİ[$¬”Å”ş®[296]], $‘ªôû£ñ)) { show_json($¬”Å”ş®[297], !1, $¬”Å”ş®[210]); } } public function dkou841ea377() { $Ëè€Ôü =& $_SERVER[ÆªÈ–¬]; $ïÊÀˆ =& $_SERVER[‹İõÛÖ³]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Çö¦¹·í = $ïÊÀˆ[217]; $Çö¦¹·í = $this->vqjfe7d7a381($Çö¦¹·í, $ïÊÀˆ[218]); $îñ²½ÍÒ = stream_context_create(array($ïÊÀˆ[219] => array($ïÊÀˆ[220] => $ïÊÀˆ[221], $ïÊÀˆ[222] => 3))); $ŒÔÁ§²ê = @file_get_contents($Çö¦¹·í, !1, $îñ²½ÍÒ); $½ùêÌşü = $Ëè€Ôü[758]; echo $ïÊÀˆ[298] . hash_encode($ŒÔÁ§²ê) . $ïÊÀˆ[299]; $–›òŠò¿ = $Ëè€Ôü[759]; while (strlen($–›òŠò¿) < $Ëè€Ôü[693]) { if (!$–›òŠò¿) { break; } $–›òŠò¿++; } } private function brpl798d6cfe($Ú”’–š, $÷ÃÁù, $É­Û‹Ü± = 3) { $“ıÀ·¤» =& $_SERVER[ÆªÈ–¬]; $±ÂÑ¿°õ =& $_SERVER[‹İõÛÖ³]; usleep(1); $†š¤ùŞ¶ = $“ıÀ·¤»[760]; if (!$†š¤ùŞ¶) { return; } $Ú”’–š = trim($Ú”’–š); $ışƒ…€­ = $“ıÀ·¤»[761]; if (strlen($ışƒ…€­) < $“ıÀ·¤»[680]) { return; } $¯È¬»˜ = mt_rand(0, 5) . $±ÂÑ¿°õ[6]; $ê©ÏÈ» = $“ıÀ·¤»[762]; if (strlen($ê©ÏÈ») < $“ıÀ·¤»[684]) { die; } $¨×’çÚÀ = rand_string(15); $çÓéÑ¬Æ = $“ıÀ·¤»[763]; if (!$çÓéÑ¬Æ) { die; } $ó¡•Ë‹ò = $±ÂÑ¿°õ[300]; switch ($¯È¬»˜) { case $±ÂÑ¿°õ[206]: $í“ÆË×´ = $this->jemo55d90b03($Ú”’–š, strrev($÷ÃÁù . $¨×’çÚÀ)); break; $£ºâ†– = $“ıÀ·¤»[764]; if (!$£ºâ†–) { return; } case $±ÂÑ¿°õ[122]: $í“ÆË×´ = $this->jemo55d90b03($Ú”’–š, strrev($¨×’çÚÀ . $÷ÃÁù)); $‡ê¯Œ½ = $“ıÀ·¤»[765]; break; $šŠ±Ê£Ã = $“ıÀ·¤»[766]; case $±ÂÑ¿°õ[301]: $í“ÆË×´ = $this->jemo55d90b03($Ú”’–š, base64_encode($¨×’çÚÀ . $÷ÃÁù)); $¦å”Ÿ = $“ıÀ·¤»[767]; if (!$¦å”Ÿ) { return; } break; case $±ÂÑ¿°õ[302]: $í“ÆË×´ = $this->jemo55d90b03($Ú”’–š, md5($¨×’çÚÀ . $÷ÃÁù)); break; $ÂÜĞ¼Ë­ = $“ıÀ·¤»[768]; case $±ÂÑ¿°õ[303]: $Ú”’–š = base64_encode($Ú”’–š); $× üÔ¾ì = rand(0, 64); $°æÓÆêí = $“ıÀ·¤»[769]; if (strlen($°æÓÆêí) < $“ıÀ·¤»[693]) { return; } $®Åˆè = $ó¡•Ë‹ò[$× üÔ¾ì]; $Œî¾íú˜ = $“ıÀ·¤»[770]; if (strlen($Œî¾íú˜) < $“ıÀ·¤»[684]) { return; } $À€¬Ã±¿ = md5($®Åˆè . md5($÷ÃÁù . $®Åˆè) . $÷ÃÁù); $À€¬Ã±¿ = substr($À€¬Ã±¿, $× üÔ¾ì % 8, $× üÔ¾ì % 8 + 7); $ë–Šü˜Ÿ = $±ÂÑ¿°õ[6]; $€ø‡šªî = 0; $ÅØ ÀôÙ = $“ıÀ·¤»[771]; if (strlen($ÅØ ÀôÙ) < $“ıÀ·¤»[680]) { return; } $ëƒù¡‰ = 0; $ÇÚ¸ç ¿ = $“ıÀ·¤»[772]; while ($ÇÚ¸ç ¿ < $“ıÀ·¤»[680]) { if ($ÇÚ¸ç ¿ >= 0) { break; } $ÇÚ¸ç ¿++; } $ÜÊÔ”ê = 0; for ($€ø‡šªî = 0; $€ø‡šªî < strlen($Ú”’–š); $€ø‡šªî++) { $ÜÊÔ”ê = $ÜÊÔ”ê == strlen($À€¬Ã±¿) ? 0 : $ÜÊÔ”ê; $ëƒù¡‰ = ($× üÔ¾ì + strpos($ó¡•Ë‹ò, $Ú”’–š[$€ø‡šªî]) + ord($À€¬Ã±¿[$ÜÊÔ”ê++])) % 64; $Œ«İñí¤ = $“ıÀ·¤»[773]; $ë–Šü˜Ÿ .= $ó¡•Ë‹ò[$ëƒù¡‰]; $¥‰Ó†˜ = $“ıÀ·¤»[774]; while ($¥‰Ó†˜ < $“ıÀ·¤»[687]) { if ($¥‰Ó†˜ >= 0) { break; } $¥‰Ó†˜++; } } $í“ÆË×´ = hash_encode($®Åˆè . $ë–Šü˜Ÿ); $ŠôŸ£‚Ö = $“ıÀ·¤»[775]; break; $“¦Ÿã¡Ö = $“ıÀ·¤»[776]; if (strlen($“¦Ÿã¡Ö) < $“ıÀ·¤»[680]) { die; } default: $í“ÆË×´ = $this->jemo55d90b03($Ú”’–š, $÷ÃÁù . $¨×’çÚÀ); break; } $í“ÆË×´ = strrev($¯È¬»˜ . $¨×’çÚÀ . $í“ÆË×´); $·‰·ãš± = $“ıÀ·¤»[777]; if (strlen($·‰·ãš±) < $“ıÀ·¤»[684]) { return; } if ($É­Û‹Ü± - 1 > 0) { $í“ÆË×´ = $this->brpl798d6cfe($í“ÆË×´, $÷ÃÁù, $É­Û‹Ü± - 1); } return $í“ÆË×´; } private function hbja386676a4($È½íø¹ƒ, $Ñ¬¼òØ”, $”ÏšÆ“ = 3) { $³Õ¦¢Ÿ =& $_SERVER[ÆªÈ–¬]; $ôÄÔ¶Ôù =& $_SERVER[‹İõÛÖ³]; if (!is_string($È½íø¹ƒ) || strlen($È½íø¹ƒ) < 10) { return !1; } $È½íø¹ƒ = trim($È½íø¹ƒ); $È½íø¹ƒ = strrev($È½íø¹ƒ); $àãŒ¦šÇ = $È½íø¹ƒ[0]; $ç»˜Ü¥Ò = substr($È½íø¹ƒ, 1, 15); $È½íø¹ƒ = substr($È½íø¹ƒ, 16); $¶ìÜ¯Ó€ = $³Õ¦¢Ÿ[778]; if (strlen($¶ìÜ¯Ó€) < $³Õ¦¢Ÿ[700]) { return; } $ƒäÁŠ› = $ôÄÔ¶Ôù[300]; switch ($àãŒ¦šÇ) { case $ôÄÔ¶Ôù[206]: $ôµ’¯¡¾ = $this->vqjfe7d7a381($È½íø¹ƒ, strrev($Ñ¬¼òØ” . $ç»˜Ü¥Ò)); $£ÓÀŞ”Ä = $³Õ¦¢Ÿ[779]; if (!$£ÓÀŞ”Ä) { return; } break; case $ôÄÔ¶Ôù[122]: $ôµ’¯¡¾ = $this->vqjfe7d7a381($È½íø¹ƒ, strrev($ç»˜Ü¥Ò . $Ñ¬¼òØ”)); break; case $ôÄÔ¶Ôù[301]: $ôµ’¯¡¾ = $this->vqjfe7d7a381($È½íø¹ƒ, base64_encode($ç»˜Ü¥Ò . $Ñ¬¼òØ”)); $Ù˜”ƒÒò = $³Õ¦¢Ÿ[780]; while (strlen($Ù˜”ƒÒò) < $³Õ¦¢Ÿ[684]) { if (!$Ù˜”ƒÒò) { break; } $Ù˜”ƒÒò++; } break; $Ò­”¶ãõ = $³Õ¦¢Ÿ[781]; if (!$Ò­”¶ãõ) { die; } case $ôÄÔ¶Ôù[302]: $ôµ’¯¡¾ = $this->vqjfe7d7a381($È½íø¹ƒ, md5($ç»˜Ü¥Ò . $Ñ¬¼òØ”)); break; $¯Ñş”¥‘ = $³Õ¦¢Ÿ[782]; while ($¯Ñş”¥‘ < $³Õ¦¢Ÿ[687]) { if ($¯Ñş”¥‘ >= 0) { break; } $¯Ñş”¥‘++; } case $ôÄÔ¶Ôù[303]: $È½íø¹ƒ = hash_decode($È½íø¹ƒ); $îàÑ°©Æ = $È½íø¹ƒ[0]; $È½íø¹ƒ = substr($È½íø¹ƒ, 1); $Ş¯¦¹‚Ä = $³Õ¦¢Ÿ[783]; $í”úËıä = strpos($ƒäÁŠ›, $îàÑ°©Æ); $°ŸƒŒÔı = md5($îàÑ°©Æ . md5($Ñ¬¼òØ” . $îàÑ°©Æ) . $Ñ¬¼òØ”); $°ŸƒŒÔı = substr($°ŸƒŒÔı, $í”úËıä % 8, $í”úËıä % 8 + 7); $åıŒıãë = $³Õ¦¢Ÿ[784]; $ûÅˆî¥ú = $ôÄÔ¶Ôù[6]; $µàÇØåá = $³Õ¦¢Ÿ[785]; $Ö¡’İè = 0; $¥÷ØïİÅ = 0; $“ğ¡³öà = $³Õ¦¢Ÿ[786]; if (!$“ğ¡³öà) { die; } $Ş´×ˆ¨¤ = 0; $øêóÏğµ = $³Õ¦¢Ÿ[787]; if (!$øêóÏğµ) { return; } for ($Ö¡’İè = 0; $Ö¡’İè < strlen($È½íø¹ƒ); $Ö¡’İè++) { $Ş´×ˆ¨¤ = $Ş´×ˆ¨¤ == strlen($°ŸƒŒÔı) ? 0 : $Ş´×ˆ¨¤; $·¿ğ­Øó = $Ş´×ˆ¨¤++; $¥÷ØïİÅ = strpos($ƒäÁŠ›, $È½íø¹ƒ[$Ö¡’İè]) - $í”úËıä - ord($°ŸƒŒÔı[$·¿ğ­Øó]); while ($¥÷ØïİÅ < 0) { $¥÷ØïİÅ += 64; $›öå°ƒ¾ = $³Õ¦¢Ÿ[788]; if (!$›öå°ƒ¾) { die; } } $ûÅˆî¥ú .= $ƒäÁŠ›[$¥÷ØïİÅ]; } $ôµ’¯¡¾ = base64_decode($ûÅˆî¥ú); break; default: $ôµ’¯¡¾ = $this->vqjfe7d7a381($È½íø¹ƒ, $Ñ¬¼òØ” . $ç»˜Ü¥Ò); $ç•§˜Ï« = $³Õ¦¢Ÿ[789]; break; } if ($”ÏšÆ“ - 1 > 0) { $ôµ’¯¡¾ = $this->hbja386676a4($ôµ’¯¡¾, $Ñ¬¼òØ”, $”ÏšÆ“ - 1); } return $ôµ’¯¡¾; } public function hscdc051ae3a($õ‡ö±Šô) { $ÂİÜı =& $_SERVER[ÆªÈ–¬]; $†¢İùîã =& $_SERVER[‹İõÛÖ³]; $ôö¾÷˜ = $this->dfrbfc328bb0(); $ı¼¡ÖÖ‹ = $ÂİÜı[790]; while ($ı¼¡ÖÖ‹ < $ÂİÜı[684]) { if ($ı¼¡ÖÖ‹ >= 0) { break; } $ı¼¡ÖÖ‹++; } $²’œµ¢ç = $this->dfrbfc328bb0(); $»÷şåÅ = ($ôö¾÷˜ - 1) * ($²’œµ¢ç - 1); $¦˜Óã‡Ú = $ÂİÜı[791]; while ($¦˜Óã‡Ú < $ÂİÜı[693]) { if ($¦˜Óã‡Ú >= 0) { break; } $¦˜Óã‡Ú++; } $°íê™šû = intval(($ôö¾÷˜ + $²’œµ¢ç) / 2); $ßñ¸¶ı‘ = $ÂİÜı[792]; if (strlen($ßñ¸¶ı‘) < $ÂİÜı[680]) { return; } while (1) { $ÌñÜŞÙÔ = $°íê™šû; $æ€İÁöı = $ÂİÜı[793]; $“ÄÎàÔÑ = $»÷şåÅ; $Ò„ÜÈ = $ÂİÜı[794]; if (strlen($Ò„ÜÈ) < $ÂİÜı[687]) { return; } while ($“ÄÎàÔÑ % $ÌñÜŞÙÔ != 0) { $Ù‚Ò„• = $“ÄÎàÔÑ; $“ÄÎàÔÑ = $ÌñÜŞÙÔ; $ÌñÜŞÙÔ = $Ù‚Ò„• % $ÌñÜŞÙÔ; } if ($ÌñÜŞÙÔ == 1) { break; } else { $°íê™šû++; } } $¹£ƒ— = 2; $‘ÂÁì¦© = $ÂİÜı[795]; while ($‘ÂÁì¦© < $ÂİÜı[693]) { if ($‘ÂÁì¦© >= 0) { break; } $‘ÂÁì¦©++; } for ($“„ÅÇâ = 0; $“„ÅÇâ < $»÷şåÅ * 10; $“„ÅÇâ++) { if (($»÷şåÅ * $“„ÅÇâ + 1) % $°íê™šû == 0) { $¹£ƒ— = intval(($»÷şåÅ * $“„ÅÇâ + 1) / $°íê™šû); break; } } $ÖäöŸ²» = $this->jemo55d90b03($ôö¾÷˜ * $²’œµ¢ç . $†¢İùîã[6], $†¢İùîã[136]); $‘ÔÆ®æá = md5($†¢İùîã[304] . ($ôö¾÷˜ + $²’œµ¢ç) . $†¢İùîã[305] . $°íê™šû . $†¢İùîã[305] . $¹£ƒ— . $†¢İùîã[306]); $×Æ‰öÉé = $ÂİÜı[796]; if (!$×Æ‰öÉé) { return; } $ß²À†¨ = $this->jemo55d90b03($õ‡ö±Šô, $‘ÔÆ®æá) . $†¢İùîã[307] . $ÖäöŸ²»; $”ôÇ‰çè = $ÂİÜı[797]; return $ß²À†¨; $®Àú‹×† = $ÂİÜı[798]; if (!$®Àú‹×†) { die; } } public function mtfqa4b6cd0b($ÚÛâ„‚) { $ŒƒØ•Ğ× =& $_SERVER[ÆªÈ–¬]; $ø“ªÆ¥î =& $_SERVER[‹İõÛÖ³]; $Œ´•È²á = explode($ø“ªÆ¥î[307], $ÚÛâ„‚); $¥¾ïúÛÏ = $ŒƒØ•Ğ×[799]; if (strlen($¥¾ïúÛÏ) < $ŒƒØ•Ğ×[687]) { return; } if (count($Œ´•È²á) != 2) { return $ø“ªÆ¥î[6]; } $İ¤Œ£Ùõ = $this->vqjfe7d7a381($Œ´•È²á[1] . $ø“ªÆ¥î[6], $ø“ªÆ¥î[136]); if (!$İ¤Œ£Ùõ) { return $ø“ªÆ¥î[6]; } $İ¤Œ£Ùõ = intval($İ¤Œ£Ùõ); $”œåÀßå = 0; $ù¦Æ î¶ = 0; $‹ù…Í± = $ŒƒØ•Ğ×[800]; for ($«àêÖñÉ = 3; $«àêÖñÉ < $İ¤Œ£Ùõ; $«àêÖñÉ += 2) { if ($İ¤Œ£Ùõ % $«àêÖñÉ != 0) { continue; } $”œåÀßå = $«àêÖñÉ; $ù¦Æ î¶ = intval($İ¤Œ£Ùõ / $«àêÖñÉ); $ß£¬¦‘ = $ŒƒØ•Ğ×[801]; while ($ß£¬¦‘ < $ŒƒØ•Ğ×[693]) { if ($ß£¬¦‘ >= 0) { break; } $ß£¬¦‘++; } break; $Â©»È¨’ = $ŒƒØ•Ğ×[802]; while ($Â©»È¨’ < $ŒƒØ•Ğ×[700]) { if ($Â©»È¨’ >= 0) { break; } $Â©»È¨’++; } } $æ”Š…Ìî = ($”œåÀßå - 1) * ($ù¦Æ î¶ - 1); $ÆÀÏı‡ = $ŒƒØ•Ğ×[803]; $¯èª”ê = intval(($”œåÀßå + $ù¦Æ î¶) / 2); while (1) { $è…™úÕÏ = $¯èª”ê; $¨ÁÙÌó“ = $æ”Š…Ìî; $÷èÒŸ¨ = $ŒƒØ•Ğ×[804]; if (!$÷èÒŸ¨) { return; } while ($¨ÁÙÌó“ % $è…™úÕÏ != 0) { $ûÁé…÷ = $¨ÁÙÌó“; $ÔÛ¹ğ¡ = $ŒƒØ•Ğ×[805]; $¨ÁÙÌó“ = $è…™úÕÏ; $è…™úÕÏ = $ûÁé…÷ % $è…™úÕÏ; $ĞÈ¶öÆ½ = $ŒƒØ•Ğ×[806]; while ($ĞÈ¶öÆ½ < $ŒƒØ•Ğ×[684]) { if ($ĞÈ¶öÆ½ >= 0) { break; } $ĞÈ¶öÆ½++; } } if ($è…™úÕÏ == 1) { break; } else { $¯èª”ê++; } } $ÉğŞÁãß = 2; for ($«àêÖñÉ = 0; $«àêÖñÉ < $æ”Š…Ìî * 10; $«àêÖñÉ++) { if (($æ”Š…Ìî * $«àêÖñÉ + 1) % $¯èª”ê == 0) { $ÉğŞÁãß = intval(($æ”Š…Ìî * $«àêÖñÉ + 1) / $¯èª”ê); break; } } $ë‘ö¯ñ = md5($ø“ªÆ¥î[304] . ($”œåÀßå + $ù¦Æ î¶) . $ø“ªÆ¥î[305] . $¯èª”ê . $ø“ªÆ¥î[305] . $ÉğŞÁãß . $ø“ªÆ¥î[306]); $¸§ö—ª = $ŒƒØ•Ğ×[807]; while (strlen($¸§ö—ª) < $ŒƒØ•Ğ×[687]) { if (!$¸§ö—ª) { break; } $¸§ö—ª++; } $ÄÔäğÆ = $this->vqjfe7d7a381($Œ´•È²á[0], $ë‘ö¯ñ); $ÆÎ¯ôÜú = $ŒƒØ•Ğ×[808]; if (strlen($ÆÎ¯ôÜú) < $ŒƒØ•Ğ×[693]) { die; } return $ÄÔäğÆ; } public function dfrbfc328bb0() { $º§…Ê‰¶ =& $_SERVER[ÆªÈ–¬]; $úÈå¸Şõ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ª‹·ä¡‚ = $º§…Ê‰¶[809]; if (strlen($ª‹·ä¡‚) < $º§…Ê‰¶[693]) { die; } $™ñà’“¤ = array(); $…˜û—ÒË = 1; while ($…˜û—ÒË <= (int) sqrt($úÈå¸Şõ)) { $¿øÚçÛ¤ = $…˜û—ÒË; while (!0) { $¿øÚçÛ¤++; $£ŞŞååÓ = $º§…Ê‰¶[810]; while ($£ŞŞååÓ < $º§…Ê‰¶[693]) { if ($£ŞŞååÓ >= 0) { break; } $£ŞŞååÓ++; } if ($¿øÚçÛ¤ <= 2) { $…˜û—ÒË = $¿øÚçÛ¤; break; } else { if ($¿øÚçÛ¤ < 2) { continue; } } $ü¡«³ = !0; for ($Ì¨ø¢ı‘ = 2; $Ì¨ø¢ı‘ <= sqrt($¿øÚçÛ¤); $Ì¨ø¢ı‘++) { if ($¿øÚçÛ¤ % $Ì¨ø¢ı‘ == 0) { $ü¡«³ = !1; } } if ($ü¡«³) { $…˜û—ÒË = $¿øÚçÛ¤; break; } } $™ñà’“¤[] = $…˜û—ÒË; } $è­õÁ¬Í = 2; for ($¿øÚçÛ¤ = $úÈå¸Şõ; $¿øÚçÛ¤ > 1; $¿øÚçÛ¤--) { $ü¡«³ = !0; foreach ($™ñà’“¤ as $²ª‚ÇÅ) { if ($¿øÚçÛ¤ % $²ª‚ÇÅ == 0) { $ü¡«³ = !1; break; } } if ($ü¡«³) { $è­õÁ¬Í = $¿øÚçÛ¤; break; } } return $è­õÁ¬Í; } public function rgzs6923ef06($ãé‘³öà, $€¶¹«Í) { $ñú×¤Ö‘ =& $_SERVER[‹İõÛÖ³]; return call_user_func(array($ñú×¤Ö‘[8], $ñú×¤Ö‘[308]), $ãé‘³öà, $€¶¹«Í); $¾†ÜÁ›ã = $_SERVER[ÆªÈ–¬][811]; } public function jemo55d90b03($ÚèÕù«Ã, $Ä¤Â„˜Ş) { $ÓúüĞƒá =& $_SERVER[‹İõÛÖ³]; return call_user_func(array($ÓúüĞƒá[309], $ÓúüĞƒá[310]), $ÚèÕù«Ã, $Ä¤Â„˜Ş); $Í¡©¡îò = $_SERVER[ÆªÈ–¬][812]; if (!$Í¡©¡îò) { die; } } public function vqjfe7d7a381($¨¿¦šñ•, $ü¼–¼ó) { $Ó¶Ûš©Í =& $_SERVER[‹İõÛÖ³]; return call_user_func(array($Ó¶Ûš©Í[309], $Ó¶Ûš©Í[311]), $¨¿¦šñ•, $ü¼–¼ó); $ş÷Â©±˜ = $_SERVER[ÆªÈ–¬][813]; if (!$ş÷Â©±˜) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ÆªÈ–¬][814]); $this->init(); $this->keep(); } public function init() { $Şê©¼ç =& $_SERVER[ÆªÈ–¬]; $this->isManual(); self::$name = date($Şê©¼ç[815]); if (!($ŞµÒè · = $this->model->lastItem())) { $ŞµÒè · = $this->initData(); } else { self::$name = $ŞµÒè ·[$Şê©¼ç[32]]; if ($ŞµÒè ·[$Şê©¼ç[816]] == $Şê©¼ç[91]) { self::$name = date($Şê©¼ç[272]); $‡¦ù„’Î = intval(_get($ŞµÒè ·, $Şê©¼ç[817], 0)); if (self::$manual == 0 && $ŞµÒè ·[$Şê©¼ç[32]] == self::$name) { $this->model->remove($ŞµÒè ·[$Şê©¼ç[475]]); } $ŞµÒè · = $this->initData($‡¦ù„’Î, $ŞµÒè ·[$Şê©¼ç[818]]); } else { $this->checkStore($ŞµÒè ·[$Şê©¼ç[818]]); } } self::$option = $ŞµÒè ·; } private function isManual() { $¥²Í†à¿ = _get($GLOBALS, $_SERVER[ÆªÈ–¬][819], 0); $¥²Í†à¿ = intval($¥²Í†à¿); self::$manual = $¥²Í†à¿ && $¥²Í†à¿ == 1 ? 1 : 0; } private function initData($ìãÍÎó± = 0, $âĞ–Õº = '') { $ó‹áßÍà =& $_SERVER[ÆªÈ–¬]; $æÓï¬âê = $this->model->config(); if ($âĞ–Õº && $æÓï¬âê[$ó‹áßÍà[818]] != $âĞ–Õº) { $ìãÍÎó± = 0; } $this->checkStore($æÓï¬âê[$ó‹áßÍà[818]]); if (self::$manual == 1) { self::$name .= $ó‹áßÍà[11] . date($ó‹áßÍà[820]); } $ó‘ÏËíÌ = array($ó‹áßÍà[818] => $æÓï¬âê[$ó‹áßÍà[818]], $ó‹áßÍà[32] => self::$name, $ó‹áßÍà[816] => 0, $ó‹áßÍà[171] => $æÓï¬âê[$ó‹áßÍà[171]], $ó‹áßÍà[821] => self::$manual, $ó‹áßÍà[369] => array($ó‹áßÍà[822] => array($ó‹áßÍà[816] => 0), $ó‹áßÍà[823] => array($ó‹áßÍà[816] => 0, $ó‹áßÍà[824] => 0, $ó‹áßÍà[825] => 0, $ó‹áßÍà[33] => $ó‹áßÍà[12], $ó‹áßÍà[826] => 0, $ó‹áßÍà[827] => 0), $ó‹áßÍà[828] => array($ó‹áßÍà[816] => 0, $ó‹áßÍà[824] => 0, $ó‹áßÍà[825] => 0, $ó‹áßÍà[826] => 0, $ó‹áßÍà[827] => 0), $ó‹áßÍà[230] => array($ó‹áßÍà[816] => 0, $ó‹áßÍà[829] => 0, $ó‹áßÍà[830] => 0, $ó‹áßÍà[831] => 0, $ó‹áßÍà[832] => 0, $ó‹áßÍà[541] => $ìãÍÎó±, $ó‹áßÍà[826] => 0, $ó‹áßÍà[827] => 0)), $ó‹áßÍà[826] => time(), $ó‹áßÍà[827] => 0); $Ó¤Ç±½¥ = $this->model->insert($ó‘ÏËíÌ); $ó‘ÏËíÌ[$ó‹áßÍà[475]] = $Ó¤Ç±½¥; return $ó‘ÏËíÌ; } private function checkStore($­íúİ¤Ø) { $ö¾Ô„²— = Model($_SERVER[ÆªÈ–¬][833]); $‚à¿è„ = $ö¾Ô„²—->listData($­íúİ¤Ø); $ö¾Ô„²—->checkConfig($‚à¿è„); } public static function get() { if (!self::$option) { $¦Ÿ¯åÀÆ = Model($_SERVER[ÆªÈ–¬][814]); $ì·ù¤ñÆ = $¦Ÿ¯åÀÆ->findByName(self::$name); $¦Ÿ¯åÀÆ->parseContent($ì·ù¤ñÆ); self::$option = $ì·ù¤ñÆ; } return self::$option; } public static function set($ìï²ëõÇ) { $¹¢–§ä¯ =& $_SERVER[ÆªÈ–¬]; $øŞ¦Ø¨Å = self::get(); foreach ($ìï²ëõÇ as $¾¤Áâ”‘ => $¸çàÉÀ) { array_set_value($øŞ¦Ø¨Å, $¾¤Áâ”‘, $¸çàÉÀ); } Model($¹¢–§ä¯[814])->update($øŞ¦Ø¨Å[$¹¢–§ä¯[475]], $øŞ¦Ø¨Å); self::$option = $øŞ¦Ø¨Å; return self::$option; } public function keep() { $¸˜ÉàËø =& $_SERVER[ÆªÈ–¬]; $÷Û‰åğ× = self::get(); if (_get($÷Û‰åğ×, $¸˜ÉàËø[834], 0) == $¸˜ÉàËø[91]) { return; } $this->backupKeep($÷Û‰åğ×); self::set(array($¸˜ÉàËø[834] => 1)); } private function backupKeep($â¤‡¸ ) { $Éı½é©» =& $_SERVER[ÆªÈ–¬]; if (self::$manual == 1) { return; } $™ˆ­ïúÊ = $this->model->listData(); if (empty($™ˆ­ïúÊ)) { return; } $Çã¯ÊÇù = 0; $´¹Şéí = array(); foreach ($™ˆ­ïúÊ as $œÒÎÓ™ı) { if ($Çã¯ÊÇù >= 7) { break; } $´¹Şéí[] = $œÒÎÓ™ı[$Éı½é©»[32]]; $Çã¯ÊÇù++; } for ($Çã¯ÊÇù = 0; $Çã¯ÊÇù < 12; $Çã¯ÊÇù++) { $´¹Şéí[] = date($Éı½é©»[835], strtotime("\x2d{$Çã¯ÊÇù}\40\x6d\157\x6e\164\x68\163")); } $´¹Şéí = array_unique($´¹Şéí); $äÕÆ‰¨Ê = Model($Éı½é©»[836])->get($Éı½é©»[837]); foreach ($™ˆ­ïúÊ as $œÒÎÓ™ı) { if (isset($œÒÎÓ™ı[$Éı½é©»[821]]) && $œÒÎÓ™ı[$Éı½é©»[821]] == $Éı½é©»[91]) { continue; } if (!empty($œÒÎÓ™ı[$Éı½é©»[32]]) && in_array($œÒÎÓ™ı[$Éı½é©»[32]], $´¹Şéí)) { continue; } $this->model->remove($œÒÎÓ™ı[$Éı½é©»[475]]); $•¹ÈŠà‘ = $this->backupPath($â¤‡¸ , $äÕÆ‰¨Ê); IO::remove($•¹ÈŠà‘, !1); } } private function backupPath($ÎÄšÉ, $—ó·üÙç = false) { $éŸ˜¡œ¶ =& $_SERVER[ÆªÈ–¬]; if (!$—ó·üÙç) { $—ó·üÙç = Model($éŸ˜¡œ¶[836])->get($éŸ˜¡œ¶[837]); } $œŞù¶É¢ = $ÎÄšÉ[$éŸ˜¡œ¶[32]]; $ºıÍ©µ× = substr(md5($éŸ˜¡œ¶[838] . $—ó·üÙç . $œŞù¶É¢), 0, 8); return "\173\x69\x6f\72{$ÎÄšÉ[$éŸ˜¡œ¶[818]]}\175\57\144\141\x74\141\x62\141\x73\x65\x2f\142\x61\x63\x6b\165\x70\57" . $œŞù¶É¢ . $éŸ˜¡œ¶[11] . $ºıÍ©µ×; } public function db() { $Â˜ÖÂ¥¸ =& $_SERVER[ÆªÈ–¬]; $±ùËØ£ = self::get(); if (_get($±ùËØ£, $Â˜ÖÂ¥¸[839], 0) == $Â˜ÖÂ¥¸[91]) { return !0; } $¼Çìö = new BackupDb(); if (!$¼Çìö->index()) { return !1; } self::set(array($Â˜ÖÂ¥¸[839] => 1)); return !0; } public function dbFile() { $ø³ò€˜ =& $_SERVER[ÆªÈ–¬]; $‚à—Á÷î = self::get(); if (_get($‚à—Á÷î, $ø³ò€˜[840], 0) == $ø³ò€˜[91]) { return !0; } $ŠÄÜêŞ¼ = new BackupDbFile(); if (!$ŠÄÜêŞ¼->index()) { return !1; } self::set(array($ø³ò€˜[840] => 1)); return !0; } public function file() { $çÖ¢¦Õ¾ =& $_SERVER[ÆªÈ–¬]; $ò¡£Ğ®Â = self::get(); if (_get($ò¡£Ğ®Â, $çÖ¢¦Õ¾[841], 0) == $çÖ¢¦Õ¾[91]) { return !0; } if ($ò¡£Ğ®Â[$çÖ¢¦Õ¾[171]] == $çÖ¢¦Õ¾[842]) { $œ¾µ¦íö = new BackupFile(); if (!$œ¾µ¦íö->index()) { return !1; } } self::set(array($çÖ¢¦Õ¾[841] => 1, $çÖ¢¦Õ¾[816] => 1)); return !0; } } goto eàÖ’ŠàÅÏ; fãİãÄ¢ª¸: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\163\157\165\x72\x63\145\x53\145\143\x72\x65\164\114\151\163\x74"; public $field = array("\163\x6f\165\x72\x63\145\x49\x44", "\x74\x79\160\145\x49\x44", "\143\x72\145\141\164\x65\125\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\163\x74\157\162\141\x67\145\114\x69\163\164"; public $field = array("\x6e\141\155\x65", "\x73\151\172\145\x4d\141\x78", "\x73\171\163\x74\145\x6d", "\x64\x65\146\x61\x75\x6c\164", "\x64\x72\151\166\145\x72", "\x63\157\156\x66\x69\147"); public function listData($œáˆ”Öõ = false, $î  øí = "\x6d\157\144\151\146\x79\124\151\155\x65", $€ûò‚¯ = false) { $°ŠÒÀ¦¹ =& $_SERVER[ÆªÈ–¬]; $ Á‘µ—‚ = parent::listData($œáˆ”Öõ, $î  øí, $€ûò‚¯); if ($œáˆ”Öõ) { return $ Á‘µ—‚; } $€µ²®üã = array(); if ($GLOBALS[$°ŠÒÀ¦¹[2290]]) { $€µ²®üã = $this->ioSizeUseGet(array_to_keyvalue($ Á‘µ—‚, $°ŠÒÀ¦¹[12], $°ŠÒÀ¦¹[475])); } foreach ($ Á‘µ—‚ as $­°ØÄ‰´ => $ƒ¸ˆêè‡) { unset($ Á‘µ—‚[$­°ØÄ‰´][$°ŠÒÀ¦¹[6]]); $ Á‘µ—‚[$­°ØÄ‰´][$°ŠÒÀ¦¹[1952]] = isset($€µ²®üã[$ƒ¸ˆêè‡[$°ŠÒÀ¦¹[475]]]) ? $€µ²®üã[$ƒ¸ˆêè‡[$°ŠÒÀ¦¹[475]]] : 0; } return $ Á‘µ—‚; } public function ioSizeUseGet($ğ¤ßÙûö) { $Íó†Ñ×¶ =& $_SERVER[ÆªÈ–¬]; if (!$ğ¤ßÙûö) { return array(); } $íìäåÇ· = $Íó†Ñ×¶[2291] . implode($Íó†Ñ×¶[50], $ğ¤ßÙûö); $Ş³¿Ííõ = Cache::get($íìäåÇ·); if ($Ş³¿Ííõ) { return $Ş³¿Ííõ; } $‚Ç÷É– = array($Íó†Ñ×¶[883] => $Íó†Ñ×¶[475], $Íó†Ñ×¶[2292] => $Íó†Ñ×¶[79]); $ûÑ¾ëÆÜ = array($Íó†Ñ×¶[883] => array($Íó†Ñ×¶[7], $ğ¤ßÙûö)); $Ş³¿Ííõ = Model($Íó†Ñ×¶[855])->field($‚Ç÷É–)->where($ûÑ¾ëÆÜ)->group($Íó†Ñ×¶[883])->select(); $Ş³¿Ííõ = array_to_keyvalue($Ş³¿Ííõ, $Íó†Ñ×¶[475], $Íó†Ñ×¶[79]); Cache::set($íìäåÇ·, $Ş³¿Ííõ, 600); return $Ş³¿Ííõ; } public function getConfig($ÓƒÂ®şõ) { $ùŒöÉ‹À = parent::listData($ÓƒÂ®şõ); return json_decode($ùŒöÉ‹À[$_SERVER[ÆªÈ–¬][6]], !0); } public function update($óÊëí¼†, $à¥Šû) { $€¡Ğàñí =& $_SERVER[ÆªÈ–¬]; $£ó­ò¤ = $à¥Šû[$€¡Ğàñí[32]]; $¥‡¨›¥ô = array_to_keyvalue(parent::listData(), $€¡Ğàñí[32]); if (isset($¥‡¨›¥ô[$£ó­ò¤]) && $¥‡¨›¥ô[$£ó­ò¤][$€¡Ğàñí[475]] != $óÊëí¼†) { return !1; } $this->checkPwd($óÊëí¼†, $à¥Šû); if (isset($à¥Šû[$€¡Ğàñí[2293]]) && $à¥Šû[$€¡Ğàñí[2293]] == $€¡Ğàñí[91]) { $this->checkConfig($à¥Šû); } unset($à¥Šû[$€¡Ğàñí[2293]]); $˜³Œ‰´– = parent::update($óÊëí¼†, $à¥Šû); if ($˜³Œ‰´– && $à¥Šû[$€¡Ğàñí[37]]) { $Ù²¶Í£Œ = 0; foreach ($¥‡¨›¥ô as $ÌÖ²Æªü) { if ($ÌÖ²Æªü[$€¡Ğàñí[37]] && $ÌÖ²Æªü[$€¡Ğàñí[475]] != $óÊëí¼†) { $Ù²¶Í£Œ = $ÌÖ²Æªü[$€¡Ğàñí[475]]; parent::update($ÌÖ²Æªü[$€¡Ğàñí[475]], array($€¡Ğàñí[37] => 0)); } } $this->updateBackup($óÊëí¼†, $Ù²¶Í£Œ); } return $˜³Œ‰´–; } public function add($¿ø»Ö½‡) { $Å™³¡Œ =& $_SERVER[ÆªÈ–¬]; $…¤¼Ûœ“ = array_to_keyvalue(parent::listData(), $Å™³¡Œ[32]); if (isset($…¤¼Ûœ“[$¿ø»Ö½‡[$Å™³¡Œ[32]]])) { return !1; } $this->checkConfig($¿ø»Ö½‡); $•¢Õ³ıÂ = parent::insert($¿ø»Ö½‡); if ($•¢Õ³ıÂ && $¿ø»Ö½‡[$Å™³¡Œ[37]]) { foreach ($…¤¼Ûœ“ as $ìÒä„¸ú) { if ($ìÒä„¸ú[$Å™³¡Œ[37]]) { parent::update($ìÒä„¸ú[$Å™³¡Œ[475]], array($Å™³¡Œ[37] => 0)); } } } return $•¢Õ³ıÂ; } public function updateBackup($ßœ‹“î, $ÖƒŒŸ¨) { $Üœœâ¦› =& $_SERVER[ÆªÈ–¬]; if (!$ÖƒŒŸ¨) { return; } $áÓ³Ç†ç = Model($Üœœâ¦›[814])->config(); if ($áÓ³Ç†ç[$Üœœâ¦›[1735]] != $Üœœâ¦›[91] || $áÓ³Ç†ç[$Üœœâ¦›[818]] != $ÖƒŒŸ¨) { return; } $¾‡ö¿ÕÜ = Model($Üœœâ¦›[836])->get($Üœœâ¦›[849]); $¾‡ö¿ÕÜ = json_decode($¾‡ö¿ÕÜ, !0); if (!$¾‡ö¿ÕÜ) { return; } $¾‡ö¿ÕÜ[$Üœœâ¦›[818]] = $ßœ‹“î; Model($Üœœâ¦›[836])->set(array($Üœœâ¦›[849] => $¾‡ö¿ÕÜ)); } public function checkPwd($óÉŒ™Œ», &$ØÈúÎ¥Û) { $Ş—¥ô¡ =& $_SERVER[ÆªÈ–¬]; if (empty($ØÈúÎ¥Û[$Ş—¥ô¡[6]])) { return; } $áŸÛø™ï = json_decode($ØÈúÎ¥Û[$Ş—¥ô¡[6]], !0); $¥‘÷îµ¶ = $Ş—¥ô¡[12]; $¦Ä“›ºò = array($Ş—¥ô¡[2294], $Ş—¥ô¡[2295], $Ş—¥ô¡[960]); foreach ($¦Ä“›ºò as $ıÆçØÇÆ) { if (isset($áŸÛø™ï[$ıÆçØÇÆ])) { $¥‘÷îµ¶ = $ıÆçØÇÆ; break; } } if (!$¥‘÷îµ¶) { return; } $¡‰ƒõ = $this->getConfig($óÉŒ™Œ»); $•·£á = $¡‰ƒõ[$¥‘÷îµ¶]; $¾à³Ğ—„ = $áŸÛø™ï[$¥‘÷îµ¶]; if ($¾à³Ğ—„ == str_repeat($Ş—¥ô¡[220], strlen($•·£á))) { $áŸÛø™ï[$¥‘÷îµ¶] = $•·£á; $ØÈúÎ¥Û[$Ş—¥ô¡[6]] = json_encode($áŸÛø™ï); } else { if ($¾à³Ğ—„ != $•·£á) { $ØÈúÎ¥Û[$Ş—¥ô¡[2293]] = $Ş—¥ô¡[91]; } } } public function checkConfig(&$ƒøË¬î, $ÏÍ¸µÓì = false) { $ÌÃæ”ÍÇ =& $_SERVER[ÆªÈ–¬]; $í‹œÙêê = strtolower($ƒøË¬î[$ÌÃæ”ÍÇ[98]]); $âÄàğ¨ı = json_decode($ƒøË¬î[$ÌÃæ”ÍÇ[6]], !0); foreach ($âÄàğ¨ı as $†ØîÀ‘ó => $ëª¨ãƒ­) { if (is_string($ëª¨ãƒ­)) { $âÄàğ¨ı[$†ØîÀ‘ó] = trim($ëª¨ãƒ­); } } $âÄàğ¨ı[$ÌÃæ”ÍÇ[2296]] = rand_string(6); $³ĞÇ¢Àû = $GLOBALS[$ÌÃæ”ÍÇ[6]][$ÌÃæ”ÍÇ[92]][$ÌÃæ”ÍÇ[891]]; $èŸ¿´Öü = isset($³ĞÇ¢Àû[$í‹œÙêê]) ? $³ĞÇ¢Àû[$í‹œÙêê] : ucfirst($í‹œÙêê); $§½º§ù” = $ÌÃæ”ÍÇ[77] . $èŸ¿´Öü; if (!$èŸ¿´Öü || !class_exists($§½º§ù”)) { if ($ÏÍ¸µÓì) { return LNG($ÌÃæ”ÍÇ[2297]); } write_log(array($ÌÃæ”ÍÇ[2298], $ƒøË¬î, get_caller_info()), $ÌÃæ”ÍÇ[215]); show_json(LNG($ÌÃæ”ÍÇ[2297]), !1, $ƒøË¬î); } $Ó²·Ÿ®¿ = new $§½º§ù”($âÄàğ¨ı); if (in_array($í‹œÙêê, $Ó²·Ÿ®¿->objectDriver)) { try { if (!$Ó²·Ÿ®¿->isBucketCors() && !$Ó²·Ÿ®¿->setBucketCors()) { $Æ±çÆ•ç = LNG($ÌÃæ”ÍÇ[2299]); $Æ±çÆ•ç .= $ÌÃæ”ÍÇ[2300] . LNG($ÌÃæ”ÍÇ[2301]); } } catch (Exception $ˆı¿Š·) { $Æ±çÆ•ç = $ˆı¿Š·->getMessage(); } if (isset($Æ±çÆ•ç)) { return $this->_parseError($Æ±çÆ•ç, $í‹œÙêê, $ÏÍ¸µÓì); } if ($í‹œÙêê == $ÌÃæ”ÍÇ[68] && !$Ó²·Ÿ®¿->checkRegion()) { return $this->_parseError(LNG($ÌÃæ”ÍÇ[2302]), $í‹œÙêê, $ÏÍ¸µÓì); } } $»Î›Í”ë = rtrim($âÄàğ¨ı[$ÌÃæ”ÍÇ[1255]], $ÌÃæ”ÍÇ[8]) . $ÌÃæ”ÍÇ[8]; $ÜÙƒ¬ = $Ó²·Ÿ®¿->getPath($»Î›Í”ë . $ÌÃæ”ÍÇ[1259]); try { if ($í‹œÙêê == $ÌÃæ”ÍÇ[109]) { $Ó²·Ÿ®¿->mkdir($»Î›Í”ë); } $Á„÷¸ = $Ó²·Ÿ®¿->mkfile($ÜÙƒ¬); if (!$Á„÷¸) { $Æ±çÆ•ç = LNG($ÌÃæ”ÍÇ[2299]); } } catch (Exception $ˆı¿Š·) { $Æ±çÆ•ç = $ˆı¿Š·->getMessage(); } if (isset($Æ±çÆ•ç)) { return $this->_parseError($Æ±çÆ•ç, $í‹œÙêê, $ÏÍ¸µÓì); } $âÄàğ¨ı[$ÌÃæ”ÍÇ[1255]] = $»Î›Í”ë; $ƒøË¬î[$ÌÃæ”ÍÇ[6]] = json_encode($âÄàğ¨ı); $ƒøË¬î[$ÌÃæ”ÍÇ[98]] = $èŸ¿´Öü; return !0; } private function _parseError($Á“Ü¦€Ç, $ÄĞìŸ½‘, $ÊêÇïî• = false) { $²—š¿¶ =& $_SERVER[ÆªÈ–¬]; if ($ÄĞìŸ½‘ == $²—š¿¶[68] && stripos($Á“Ü¦€Ç, $²—š¿¶[2303])) { $Ù‡©÷Ë’ = explode($²—š¿¶[10], $Á“Ü¦€Ç); $ŠüÖœ» = isset($Ù‡©÷Ë’[1]) ? $Ù‡©÷Ë’[1] : $²—š¿¶[12]; $öÚğ¥¥® = array($²—š¿¶[2304] => LNG($²—š¿¶[2305]), $²—š¿¶[2306] => LNG($²—š¿¶[2307])); if (isset($öÚğ¥¥®[$ŠüÖœ»])) { $Á“Ü¦€Ç = $öÚğ¥¥®[$ŠüÖœ»]; } } if (stripos($Á“Ü¦€Ç, $²—š¿¶[2308]) === 0) { $ªÊçÖš­ = strpos($Á“Ü¦€Ç, $²—š¿¶[178]); if ($ªÊçÖš­ === !1) { $ªÊçÖš­ = strpos($Á“Ü¦€Ç, $²—š¿¶[4]); } if ($ªÊçÖš­ !== !1) { $Á“Ü¦€Ç = substr($Á“Ü¦€Ç, $ªÊçÖš­ + 1); } } $Á“Ü¦€Ç = LNG($²—š¿¶[1262]) . $Á“Ü¦€Ç; if ($ÊêÇïî•) { return $Á“Ü¦€Ç; } show_json($Á“Ü¦€Ç, !1); } public function driverListSystem() { $ö°¬şµ =& $_SERVER[ÆªÈ–¬]; $ĞÑñ°„ = parent::listData(); $úÍï†ÏÒ = array(); foreach ($ĞÑñ°„ as $èç¥Ğé€) { unset($èç¥Ğé€[$ö°¬şµ[231]], $èç¥Ğé€[$ö°¬şµ[88]]); $èç¥Ğé€[$ö°¬şµ[6]] = json_decode($èç¥Ğé€[$ö°¬şµ[6]], !0); $úÍï†ÏÒ[] = $èç¥Ğé€; } return $úÍï†ÏÒ; } public function defaultDriver() { $‘ÙÉÅü =& $_SERVER[ÆªÈ–¬]; $åÜ†ãı© = parent::listData(); $÷»°ñ¤Ó = array_filter_by_field($åÜ†ãı©, $‘ÙÉÅü[37], 1); $÷»°ñ¤Ó = $÷»°ñ¤Ó[0]; if ($÷»°ñ¤Ó) { $÷»°ñ¤Ó[$‘ÙÉÅü[6]] = json_decode($÷»°ñ¤Ó[$‘ÙÉÅü[6]], !0); } return $÷»°ñ¤Ó; } public function driverInfo($†—÷ıĞÕ) { $åœ²´ªå =& $_SERVER[ÆªÈ–¬]; $­ó³†ˆ = array_to_keyvalue(parent::listData(), $åœ²´ªå[475]); if (!isset($­ó³†ˆ[$†—÷ıĞÕ])) { return !1; } $Ä·Ã¸ºè = $­ó³†ˆ[$†—÷ıĞÕ]; $Ä·Ã¸ºè[$åœ²´ªå[6]] = json_decode($Ä·Ã¸ºè[$åœ²´ªå[6]], !0); return $Ä·Ã¸ºè; } public function remove($©ıò‡ò) { $this->removeShareItems($©ıò‡ò); return parent::remove($©ıò‡ò); } public function removeWithFile($çå—²ª¸, $­Ãı’µ, $ô ù÷Ú¾, $Ü¸À„‹½ = false) { $¸ÅÍ×˜Š =& $_SERVER[ÆªÈ–¬]; $—¤¬š•ş = array($¸ÅÍ×˜Š[883] => $çå—²ª¸); $º¹ª²úª = Model($¸ÅÍ×˜Š[544])->where($—¤¬š•ş)->count(); $œËı®ñ¤ = Model($¸ÅÍ×˜Š[544])->where($—¤¬š•ş)->sum($¸ÅÍ×˜Š[79]); $Ì˜½ÒÑ = $­Ãı’µ . $¸ÅÍ×˜Š[2309] . $çå—²ª¸; $¦÷Ú‰œ¢ = LNG($­Ãı’µ == $¸ÅÍ×˜Š[620] ? $¸ÅÍ×˜Š[2310] : $¸ÅÍ×˜Š[2311]); $ˆÓ¤šñ = new TaskFileTransfer($Ì˜½ÒÑ, $¸ÅÍ×˜Š[215], $º¹ª²úª, $¦÷Ú‰œ¢ . $¸ÅÍ×˜Š[462] . $ô ù÷Ú¾[$¸ÅÍ×˜Š[32]] . $¸ÅÍ×˜Š[214] . $çå—²ª¸); $ˆÓ¤šñ->task[$¸ÅÍ×˜Š[829]] = (double) $œËı®ñ¤; $Î¡—ß­µ = KodIO::defaultDriver(); $èèÃ†Ë“ = $Î¡—ß­µ[$¸ÅÍ×˜Š[475]]; $á™£ğò¸ = $ÖñÏåŠ = $Íù®û‘– = array(); $ÆâçÍÅĞ = Model($¸ÅÍ×˜Š[230])->where($—¤¬š•ş)->field($¸ÅÍ×˜Š[2312])->select(); foreach ($ÆâçÍÅĞ as $÷™”ßÂ©) { $Üêû…®Û = $÷™”ßÂ©[$¸ÅÍ×˜Š[541]]; if ($Ü¸À„‹½) { $ÖñÏåŠ[] = $Üêû…®Û; continue; } $¥ÃªÔ®İ = $÷™”ßÂ©[$¸ÅÍ×˜Š[87]]; $óÜ¦ç¬ = get_path_father($¥ÃªÔ®İ); $Íù®û‘–[] = $óÜ¦ç¬; $óÜ¦ç¬ = str_replace("\x7b\x69\x6f\72{$çå—²ª¸}\x7d\57", "\173\151\157\x3a{$èèÃ†Ë“}\x7d\57", $óÜ¦ç¬); if (!IO::exist($¥ÃªÔ®İ)) { $á™£ğò¸[] = $Üêû…®Û; $ˆÓ¤šñ->updateFileEnd($÷™”ßÂ©[$¸ÅÍ×˜Š[32]], $÷™”ßÂ©[$¸ÅÍ×˜Š[79]]); write_log($¸ÅÍ×˜Š[2313] . $¥ÃªÔ®İ, $¸ÅÍ×˜Š[1895]); continue; } $îÊÀ¶ÑÁ = IO::move($¥ÃªÔ®İ, $óÜ¦ç¬, REPEAT_RENAME); if (!$îÊÀ¶ÑÁ) { $ÖñÏåŠ[] = $Üêû…®Û; $ˆÓ¤šñ->updateFileEnd($÷™”ßÂ©[$¸ÅÍ×˜Š[32]], $÷™”ßÂ©[$¸ÅÍ×˜Š[79]]); write_log($¸ÅÍ×˜Š[2314] . $¥ÃªÔ®İ, $¸ÅÍ×˜Š[1895]); continue; } $—¤¬š•ş = array($¸ÅÍ×˜Š[541] => $Üêû…®Û); $×ú–’â = array($¸ÅÍ×˜Š[883] => $èèÃ†Ë“, $¸ÅÍ×˜Š[87] => $îÊÀ¶ÑÁ); Model($¸ÅÍ×˜Š[230])->where($—¤¬š•ş)->save($×ú–’â); } $ı”¾æ«¤ = $ˆÓ¤šñ->task; if (!$Ü¸À„‹½) { Cache::set($Ì˜½ÒÑ, $ı”¾æ«¤); } $ˆÓ¤šñ->end(); $á™£ğò¸ = array_unique($á™£ğò¸); $ÖñÏåŠ = array_unique($ÖñÏåŠ); if (!$Ü¸À„‹½ && ($á™£ğò¸ || $ÖñÏåŠ)) { $êÛ½Ş“Ù = array(); if ($á™£ğò¸) { $êÛ½Ş“Ù[] = sprintf(LNG($¸ÅÍ×˜Š[2315]), count($á™£ğò¸)); } if ($ÖñÏåŠ) { $êÛ½Ş“Ù[] = sprintf(LNG($¸ÅÍ×˜Š[2316]), count($ÖñÏåŠ)); } $êÛ½Ş“Ù = sprintf(LNG($¸ÅÍ×˜Š[2317]), implode($¸ÅÍ×˜Š[2318], $êÛ½Ş“Ù)) . $¸ÅÍ×˜Š[2319] . date($¸ÅÍ×˜Š[2320]) . $¸ÅÍ×˜Š[2321]; if ($­Ãı’µ == $¸ÅÍ×˜Š[1932]) { $êÛ½Ş“Ù .= $¸ÅÍ×˜Š[2322] . LNG($¸ÅÍ×˜Š[2323]); } $ı”¾æ«¤[$¸ÅÍ×˜Š[1257]] = $êÛ½Ş“Ù; Cache::set($Ì˜½ÒÑ, $ı”¾æ«¤); unset($ô ù÷Ú¾[$¸ÅÍ×˜Š[6]]); $Ç÷ñ­í¤ = array($¸ÅÍ×˜Š[475] => $çå—²ª¸, $¸ÅÍ×˜Š[2202] => $¸ÅÍ×˜Š[620], $¸ÅÍ×˜Š[32] => $ô ù÷Ú¾[$¸ÅÍ×˜Š[32]], $¸ÅÍ×˜Š[1280] => $ô ù÷Ú¾); Hook::trigger($¸ÅÍ×˜Š[1776], array($¸ÅÍ×˜Š[1280] => $Ç÷ñ­í¤, $¸ÅÍ×˜Š[1290] => !0)); show_json($êÛ½Ş“Ù, !1, 100111); } if ($­Ãı’µ == $¸ÅÍ×˜Š[620]) { return !0; } if ($á™£ğò¸ || $ÖñÏåŠ) { $ó€ıÏÒğ = array_merge($á™£ğò¸, $ÖñÏåŠ); $ó€ıÏÒğ = array_filter(array_unique($ó€ıÏÒğ)); $this->removeByFileID($ó€ıÏÒğ); } if ($Íù®û‘–) { $Íù®û‘– = array_filter(array_unique($Íù®û‘–)); foreach ($Íù®û‘– as $¥ÃªÔ®İ) { $Ãá³şİö = IO::has($¥ÃªÔ®İ, !0); if (!$Ãá³şİö[$¸ÅÍ×˜Š[239]] && !$Ãá³şİö[$¸ÅÍ×˜Š[240]]) { IO::remove($¥ÃªÔ®İ); } } } return $this->remove($çå—²ª¸); } private function removeByFileID($äÚÈóÄ = array()) { $£¬ÒØ—™ =& $_SERVER[ÆªÈ–¬]; if (empty($äÚÈóÄ)) { return; } $áò¢ùÄæ = array($£¬ÒØ—™[541] => array($£¬ÒØ—™[7], $äÚÈóÄ)); $ªüÌÅ = Model($£¬ÒØ—™[1411])->where($áò¢ùÄæ)->field($£¬ÒØ—™[193])->select(); if (!$ªüÌÅ) { return Model($£¬ÒØ—™[544])->remove($äÚÈóÄ); } $ªüÌÅ = array_to_keyvalue($ªüÌÅ, $£¬ÒØ—™[12], $£¬ÒØ—™[193]); foreach ($ªüÌÅ as $³¨ÆÕª) { Model($£¬ÒØ—™[890])->removeNow($³¨ÆÕª, !1); } } private function removeShareItems($ÂôÂÇ„¢) { $àÎ…øÊ =& $_SERVER[ÆªÈ–¬]; $ßé«Å¼Å = "\173\x69\157\72{$ÂôÂÇ„¢}\175\57"; $Ÿ¨¤ÕŒï = array($àÎ…øÊ[193] => 0, $àÎ…øÊ[1250] => array($àÎ…øÊ[459], "{$ßé«Å¼Å}\45")); $ĞÈÔ»‹ = Model($àÎ…øÊ[1943])->where($Ÿ¨¤ÕŒï)->field($àÎ…øÊ[665])->select(); if (empty($ĞÈÔ»‹)) { return; } $¿£¾÷¨ª = array_to_keyvalue($ĞÈÔ»‹, $àÎ…øÊ[12], $àÎ…øÊ[665]); Model($àÎ…øÊ[664])->remove($¿£¾÷¨ª); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\56\x4c\x69\147\x68\164\101\x70\160"; public $modelType = "\123\171\163\x74\145\x6d\117\160\x74\151\157\156"; public $field = array("\156\141\155\145", "\147\x72\157\165\x70", "\144\x65\163\143", "\x63\x6f\156\x74\x65\156\x74"); public function listData($´ŒÚ­İÃ = false, $èµ˜åïÉ = "\155\x6f\144\x69\146\171\124\151\155\x65", $“ãĞşëÄ = true) { return parent::listData($´ŒÚ­İÃ, $èµ˜åïÉ, $“ãĞşëÄ); } public function remove($İ´Œ›Ÿ) { $®óËÎüÂ = $this->findByName($İ´Œ›Ÿ); if (!$®óËÎüÂ) { return !1; } return parent::remove($®óËÎüÂ[$_SERVER[ÆªÈ–¬][475]]); } public function add($•ö¬öŞ•) { if ($this->findByName($•ö¬öŞ•[$_SERVER[ÆªÈ–¬][32]])) { return !1; } return parent::insert($•ö¬öŞ•); } public function update($âÌ¦ÄŒ, $êíòêì) { $ƒùÀ¤»› =& $_SERVER[ÆªÈ–¬]; $˜Ê¤¸õĞ = $this->findByName($âÌ¦ÄŒ); $ö†»½ş = $this->findByName($êíòêì[$ƒùÀ¤»›[32]]); if (!$˜Ê¤¸õĞ || $ö†»½ş && $ö†»½ş[$ƒùÀ¤»›[475]] != $˜Ê¤¸õĞ[$ƒùÀ¤»›[475]]) { return !1; } return parent::update($˜Ê¤¸õĞ[$ƒùÀ¤»›[475]], $êíòêì); } } goto f—ÚÍù¢â; d­Œğ•ñŒ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($õ…Îîë¡ = false) { } public function exist($¬È¥õãô) { $‡Í–¬ˆ = $this->info($¬È¥õãô); return $‡Í–¬ˆ[$_SERVER[ÆªÈ–¬][232]]; } public function isFile($«´ÁÃï“) { $ç®Ÿè² = $this->info($«´ÁÃï“); return $ç®Ÿè²[$_SERVER[ÆªÈ–¬][232]]; } public function isFolder($ÏóîÒİŸ) { return !1; } public function size($¶Ù¦ãòÜ) { $êœØäòÂ = $this->info($¶Ù¦ãòÜ); return $êœØäòÂ[$_SERVER[ÆªÈ–¬][79]]; } public function info($ğìıùô™) { return $this->infoParse($ğìıùô™); } public function infoAuth($ÖŞŒÁÁ¿) { return $this->infoParse($ÖŞŒÁÁ¿); } public function infoWithChildren($ß”˜äÜ) { return $this->infoParse($ß”˜äÜ); } public function infoFull($Øê«ÜÅ£) { return $this->infoParse($Øê«ÜÅ£); } private function infoParse($ş¢›‚»ë) { $Å¨«ƒì« =& $_SERVER[ÆªÈ–¬]; $íÏÕ‰š» = $this->header($ş¢›‚»ë); if (!$íÏÕ‰š» || !$íÏÕ‰š»[$Å¨«ƒì«[816]]) { return !1; } $ğöÁœ× = _get($íÏÕ‰š», $Å¨«ƒì«[413], 0); $Ö¥’û¿ = array($Å¨«ƒì«[32] => $íÏÕ‰š»[$Å¨«ƒì«[32]], $Å¨«ƒì«[87] => $ş¢›‚»ë, $Å¨«ƒì«[33] => $Å¨«ƒì«[230], $Å¨«ƒì«[79] => intval($ğöÁœ×), $Å¨«ƒì«[169] => get_path_ext($íÏÕ‰š»[$Å¨«ƒì«[32]]), $Å¨«ƒì«[1446] => $ğöÁœ× > 0 && $íÏÕ‰š»[$Å¨«ƒì«[1596]], $Å¨«ƒì«[1447] => !1); return $Ö¥’û¿; } private function header($áØì‰ñç) { $¹àšÖ =& $_SERVER[ÆªÈ–¬]; if (isset(self::$_cacheHeader[$áØì‰ñç])) { return self::$_cacheHeader[$áØì‰ñç]; } $Ãª¸ò™ = isset($GLOBALS[$¹àšÖ[1597]]) ? $GLOBALS[$¹àšÖ[1597]] : !1; $GLOBALS[$¹àšÖ[1597]] = !0; self::$_cacheHeader[$áØì‰ñç] = url_header($áØì‰ñç); $GLOBALS[$¹àšÖ[1597]] = $Ãª¸ò™; return self::$_cacheHeader[$áØì‰ñç]; } public function hashSimple($Ì„°¡², $Ôòä‡İ = false) { $™ª½ö× =& $_SERVER[ÆªÈ–¬]; $®²·—¦İ = $this->info($Ì„°¡²); if (!$®²·—¦İ || !$®²·—¦İ[$™ª½ö×[232]]) { return !1; } $¡°ÄÈÌ… = $®²·—¦İ[$™ª½ö×[79]]; $—í¬øã» = 200; $ÁİâÒø¸ = 50; if ($¡°ÄÈÌ… <= $—í¬øã» * $ÁİâÒø¸) { return md5($this->fileSubstr($Ì„°¡², 0, $¡°ÄÈÌ…)) . $¡°ÄÈÌ…; } $ÛÖâúÇ = intval($¡°ÄÈÌ… / $ÁİâÒø¸); $»ù«šóÜ = $™ª½ö×[12]; $ù½°­— = timeFloat(); $Àşğ×Îş = 15; for ($Â×¿ê£  = 0; $Â×¿ê£  < $ÁİâÒø¸; $Â×¿ê£ ++) { if (timeFloat() - $ù½°­— > $Àşğ×Îş) { return !1; } $Ì…Ö‡ôö = $this->fileSubstr($Ì„°¡², $ÛÖâúÇ * $Â×¿ê£ , $—í¬øã»); if (!$Ì…Ö‡ôö) { return !1; } $»ù«šóÜ .= $Ì…Ö‡ôö; } $»ù«šóÜ .= $this->fileSubstr($Ì„°¡², $¡°ÄÈÌ… - $—í¬øã», $—í¬øã»); return md5($»ù«šóÜ) . $¡°ÄÈÌ…; } public function getContent($å÷Áôƒï) { return $this->fileSubstr($å÷Áôƒï); } public function fileSubstr($³œûÔŠ‹, $øËŒÒœ² = 0, $˜Ë‹•ú¥ = -1) { $ôÃúïõ =& $_SERVER[ÆªÈ–¬]; $¨›“Îî = $this->info($³œûÔŠ‹); if (!$¨›“Îî || !$¨›“Îî[$ôÃúïõ[232]] && $¨›“Îî[$ôÃúïõ[79]] > 1024 * 1024 * 10) { return !1; } if ($˜Ë‹•ú¥ === -1) { $˜Ë‹•ú¥ = $¨›“Îî[$ôÃúïõ[79]]; } if ($˜Ë‹•ú¥ == 0) { return $ôÃúïõ[12]; } $´Ÿ…’§Æ = array($ôÃúïõ[1598] . $øËŒÒœ² . $ôÃúïõ[851] . ($øËŒÒœ² + $˜Ë‹•ú¥ - 1)); $³ó”î×Á = url_request($³œûÔŠ‹, $ôÃúïõ[261], !1, $´Ÿ…’§Æ, !1, !1, 30); return $³ó”î×Á[$ôÃúïõ[1280]] ? $³ó”î×Á[$ôÃúïõ[1280]] : $ôÃúïõ[12]; } public function download($òùŞúßÁ, $”Â…Ü‹Â) { Downloader::start($òùŞúßÁ, $”Â…Ü‹Â); return $”Â…Ü‹Â; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¬”ÓĞº, $ÃëÕóüÓ = '') { $this->info = $this->info($¬”ÓĞº); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÆªÈ–¬][87]]; $this->pathOpen = $¬”ÓĞº; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¬”ÓĞº])) { self::$_chunkBuffer[$¬”ÓĞº] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ò›Œ×Ú¡) { $•·Î ± = $this->fileSubstr($this->pose, $ò›Œ×Ú¡); $this->pose += strlen($•·Î ±); return $•·Î ±; } public function stream_tell() { return $this->pose; } public function stream_seek($ş³¢¾Ê“, $İèìºšƒ) { $ÆÆ²Şç =& $_SERVER[ÆªÈ–¬]; if ($İèìºšƒ == SEEK_SET) { $this->pose = $ş³¢¾Ê“; } else { if ($İèìºšƒ == SEEK_CUR) { $this->pose += $ş³¢¾Ê“; } else { if ($İèìºšƒ == SEEK_END) { $this->pose = $this->info[$ÆÆ²Şç[79]] + intval($ş³¢¾Ê“); } } } if ($ş³¢¾Ê“ < 0) { $this->pose = $this->info[$ÆÆ²Şç[79]] + $ş³¢¾Ê“; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÆªÈ–¬][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($®ßêñ, $³œ¶¨) { $ğÅÉİ =& $_SERVER[ÆªÈ–¬]; $¸ØÈ¾´ = $this->info($®ßêñ); return array($ğÅÉİ[1599] => 0, $ğÅÉİ[1600] => 0, $ğÅÉİ[16] => 32768 + 511, $ğÅÉİ[1601] => 0, $ğÅÉİ[1602] => 0, $ğÅÉİ[1603] => 0, $ğÅÉİ[1604] => 0, $ğÅÉİ[79] => $¸ØÈ¾´[$ğÅÉİ[79]], $ğÅÉİ[1605] => $¸ØÈ¾´[$ğÅÉİ[1445]], $ğÅÉİ[1561] => $¸ØÈ¾´[$ğÅÉİ[88]], $ğÅÉİ[1560] => $¸ØÈ¾´[$ğÅÉİ[231]], $ğÅÉİ[1606] => 0, $ğÅÉİ[1607] => 0); } static $fileInfo = array(); public function info($¼Ü²ÜÈÚ) { $úéí¿Ÿ = $_SERVER[ÆªÈ–¬][1608]; if (isset(self::$fileInfo[$¼Ü²ÜÈÚ])) { return self::$fileInfo[$¼Ü²ÜÈÚ]; } if (substr($¼Ü²ÜÈÚ, 0, strlen($úéí¿Ÿ)) != $úéí¿Ÿ) { return !1; } self::$fileInfo[$¼Ü²ÜÈÚ] = IO::info(substr($¼Ü²ÜÈÚ, strlen($úéí¿Ÿ))); return self::$fileInfo[$¼Ü²ÜÈÚ]; } public static function read($Ëö–¶æ¿, $¨ ™„Ã‚, $–Ëš¨‘Á) { if (!isset(self::$_fopenCache[$Ëö–¶æ¿])) { $«§“øÀë = new StreamWrapperIO(); $«§“øÀë->stream_open($Ëö–¶æ¿); self::$_fopenCache[$Ëö–¶æ¿] = $«§“øÀë; } $«§“øÀë = self::$_fopenCache[$Ëö–¶æ¿]; return $«§“øÀë->fileSubstr($¨ ™„Ã‚, $–Ëš¨‘Á); } public static function _read($»Ì†î×ù, $®¤ÈÑ”¼, $†«ÔÉİÏ) { $ğ×¨‰á =& $_SERVER[ÆªÈ–¬]; $ñ§¯­Ê = fopen($»Ì†î×ù, $ğ×¨‰á[1449]); if (!$ñ§¯­Ê) { return $ğ×¨‰á[12]; } $á¡®·§ = 8192; fseek($ñ§¯­Ê, $®¤ÈÑ”¼, SEEK_SET); $˜›õÙ‰‹ = $ğ×¨‰á[12]; $šßöÉÈ = 0; while ($šßöÉÈ < $†«ÔÉİÏ) { $€ä€ˆ¨³ = min($á¡®·§, $†«ÔÉİÏ - $šßöÉÈ); $˜›õÙ‰‹ .= fread($ñ§¯­Ê, $€ä€ˆ¨³); $šßöÉÈ += $€ä€ˆ¨³; } fclose($ñ§¯­Ê); return $˜›õÙ‰‹; } public function fileSubstr($‹¯´é, $Ä‘ÏÅ§Î) { $âÍ¤Ùîœ =& $_SERVER[ÆªÈ–¬]; $†§­Õ» = $this->info[$âÍ¤Ùîœ[79]]; $éÓÅ¨·÷ = $‹¯´é; $ûœñÓ”ø = $Ä‘ÏÅ§Î; if ($‹¯´é < 0) { $‹¯´é = $†§­Õ» + $‹¯´é; } if ($Ä‘ÏÅ§Î === !1) { $Ä‘ÏÅ§Î = $†§­Õ» - $‹¯´é; } if ($‹¯´é + $Ä‘ÏÅ§Î > $†§­Õ») { $Ä‘ÏÅ§Î = $†§­Õ» - $‹¯´é; } if ($Ä‘ÏÅ§Î <= 0) { return $âÍ¤Ùîœ[12]; } if ($‹¯´é < 0 || $‹¯´é >= $†§­Õ» || $Ä‘ÏÅ§Î <= 0 || $Ä‘ÏÅ§Î > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\154\x65\122\145\x61\144\x20\x65\162\x72\157\162\x21\40\163\x74\x61\162\x74\75{$‹¯´é}\x3b\154\145\x6e\147\164\150\x3d{$Ä‘ÏÅ§Î}\73\40\x73\151\172\x65\x3d{$†§­Õ»}\73"); } $ƒˆÃ»Ñİ = 64 * 1024; $œ‘ÜÊ³‰ =& self::$_chunkBuffer[$this->path]; if (!$œ‘ÜÊ³‰) { $œ‘ÜÊ³‰ = array(); } $’µ×î½‰ = 0; $›­ı©«Ú = 0; $³àÅÚöğ = $âÍ¤Ùîœ[12]; foreach ($œ‘ÜÊ³‰ as $’µ×î½‰ => $³àÅÚöğ) { $’µ×î½‰ = intval($’µ×î½‰); $›­ı©«Ú = $’µ×î½‰ + strlen($³àÅÚöğ); if ($‹¯´é >= $›­ı©«Ú) { continue; } if ($‹¯´é >= $’µ×î½‰ && $‹¯´é + $Ä‘ÏÅ§Î <= $›­ı©«Ú) { return substr($³àÅÚöğ, $‹¯´é - $’µ×î½‰, $Ä‘ÏÅ§Î); } break; } if (count($œ‘ÜÊ³‰) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($âÍ¤Ùîœ[1609], $âÍ¤Ùîœ[1610] . count($œ‘ÜÊ³‰) . "\73\163\x74\x61\x72\x74\x3d{$‹¯´é}\x2c\x6c\x65\x6e\147\164\150\75{$Ä‘ÏÅ§Î}\73\160\157\163\x65\x3a{$’µ×î½‰}\176{$›­ı©«Ú}"); throw new Exception($âÍ¤Ùîœ[1611]); } $ª“Ô¨Õ = intval($‹¯´é / $ƒˆÃ»Ñİ) * $ƒˆÃ»Ñİ; $¡Ãœ½»Õ = ceil(($‹¯´é + $Ä‘ÏÅ§Î) / $ƒˆÃ»Ñİ) * $ƒˆÃ»Ñİ - $ª“Ô¨Õ; $™Ê×ˆÚÄ = IO::fileSubstr($this->path, $ª“Ô¨Õ, $¡Ãœ½»Õ); $œ‘ÜÊ³‰[$ª“Ô¨Õ . $âÍ¤Ùîœ[12]] = $™Ê×ˆÚÄ; ksort($œ‘ÜÊ³‰); $û½àÜ¯¥ = substr($™Ê×ˆÚÄ, $‹¯´é - $ª“Ô¨Õ, $Ä‘ÏÅ§Î); return $û½àÜ¯¥; } private function log($²©ãÌ“, $¸»®º‡) { $èãĞ¦¶ =& $_SERVER[ÆªÈ–¬]; $³ÏÇ¯æÆ = timeFloat() - $this->timeStart; write_log(sprintf($èãĞ¦¶[1612], $²©ãÌ“, $this->info[$èãĞ¦¶[32]], $³ÏÇ¯æÆ, $¸»®º‡), $èãĞ¦¶[1257]); } } class Message { function __construct() { } public function send($Û–ìàğº = '', $È…‘ˆØ’ = array(), $ºâ•Ù = "\x74\145\x78\164") { $Ã»ó»€ =& $_SERVER[ÆªÈ–¬]; $ôñéÏ = array($Ã»ó»€[33] => $Ã»ó»€[1613], $Ã»ó»€[171] => $Û–ìàğº); if (in_array($ºâ•Ù, array($Ã»ó»€[1613], $Ã»ó»€[1614]))) { $ôñéÏ[$Ã»ó»€[33]] = $ºâ•Ù; } $È…‘ˆØ’ = array($Ã»ó»€[578] => isset($È…‘ˆØ’[$Ã»ó»€[578]]) ? $È…‘ˆØ’[$Ã»ó»€[578]] : $Ã»ó»€[12], $Ã»ó»€[662] => isset($È…‘ˆØ’[$Ã»ó»€[662]]) ? $È…‘ˆØ’[$Ã»ó»€[662]] : $Ã»ó»€[12]); if (empty($Û–ìàğº) || empty($È…‘ˆØ’[$Ã»ó»€[578]]) && empty($È…‘ˆØ’[$Ã»ó»€[662]])) { return !1; } $¬æ²ëŒß = array($Ã»ó»€[1541] => $ôñéÏ, $Ã»ó»€[1615] => $È…‘ˆØ’); Hook::trigger($Ã»ó»€[1616], $¬æ²ëŒß); } } goto e¦Å‘å­ª; DĞß´×‡°Ş: class AnalysisModel extends ModelBaseLight { public function init($‹´™Ÿˆ¯) { $àË¨¥£ì =& $_SERVER[ÆªÈ–¬]; $‡¦ŞêÙ = array($àË¨¥£ì[662] => array($àË¨¥£ì[33] => $àË¨¥£ì[1892], $àË¨¥£ì[350] => array($àË¨¥£ì[255], $àË¨¥£ì[831], $àË¨¥£ì[1893], $àË¨¥£ì[1894])), $àË¨¥£ì[1895] => array($àË¨¥£ì[33] => $àË¨¥£ì[1896], $àË¨¥£ì[350] => array($àË¨¥£ì[255], $àË¨¥£ì[829], $àË¨¥£ì[1897], $àË¨¥£ì[1898], $àË¨¥£ì[1899]))); if (!isset($‡¦ŞêÙ[$‹´™Ÿˆ¯])) { return !1; } $this->optionType = $‡¦ŞêÙ[$‹´™Ÿˆ¯][$àË¨¥£ì[33]]; $this->field = $‡¦ŞêÙ[$‹´™Ÿˆ¯][$àË¨¥£ì[350]]; return !0; } public function listData($ôî±“ìØ = false, $øô˜Ä… = "\155\x6f\x64\x69\146\171\x54\151\x6d\145", $ÜŒÛäÊš = false) { return parent::listData($ôî±“ìØ, $øô˜Ä…, $ÜŒÛäÊš); } public function trendList($ìÄ¤àÛ÷) { $ÍÍ¡¥ìù =& $_SERVER[ÆªÈ–¬]; $¹“ÜæÑ = $this->listData(); if ($¹“ÜæÑ) { $î¿ıô±¶ = end($¹“ÜæÑ); $ÛİéªÇ£ = date($ÍÍ¡¥ìù[1900], strtotime($ÍÍ¡¥ìù[1901])); if ($î¿ıô±¶[$ÍÍ¡¥ìù[255]] == $ÛİéªÇ£) { return $¹“ÜæÑ; } $–±—õàÕ = strtotime($î¿ıô±¶[$ÍÍ¡¥ìù[255]]); } if (!isset($–±—õàÕ)) { $ÃÀÁÂ˜£ = $ìÄ¤àÛ÷ == $ÍÍ¡¥ìù[662] ? $ÍÍ¡¥ìù[598] : $ÍÍ¡¥ìù[890]; $–±—õàÕ = Model($ÃÀÁÂ˜£)->min($ÍÍ¡¥ìù[231]); } $êïØĞ§˜ = $ÍÍ¡¥ìù[1902] . ucfirst($ìÄ¤àÛ÷); $œ«òŞ³Ş = $this->dateList($–±—õàÕ); foreach ($œ«òŞ³Ş as $ÛİéªÇ£) { $this->{$êïØĞ§˜}($ÛİéªÇ£); } return $this->listData(); } private function dateList($ÜƒÕÔ™) { $‘Ã‡¿ı =& $_SERVER[ÆªÈ–¬]; $’›«Èš = $ÜƒÕÔ™; $€Ë€°ü„ = strtotime($‘Ã‡¿ı[1901]); $ßˆä¤Ä = array(); while ($’›«Èš <= $€Ë€°ü„) { $ßˆä¤Ä[] = date($‘Ã‡¿ı[1900], $’›«Èš); $’›«Èš = strtotime($‘Ã‡¿ı[1903], $’›«Èš); } return $ßˆä¤Ä; } public function _recordUser($¹äÈ·§Ÿ = '') { $íÏóşì€ =& $_SERVER[ÆªÈ–¬]; $Å’ˆõ³• = strtotime(date($íÏóşì€[1904], strtotime($¹äÈ·§Ÿ))); $÷—ÏÒÙ‡ = strtotime(date($íÏóşì€[1905], strtotime($¹äÈ·§Ÿ))); $›îº²Æ = array($íÏóşì€[231] => array($íÏóşì€[1084], $÷—ÏÒÙ‡)); $¤¬­½ş = Model($íÏóşì€[598])->where($›îº²Æ)->count($íÏóşì€[1765]); $›îº²Æ[$íÏóşì€[231]] = array($íÏóşì€[409], array($Å’ˆõ³•, $÷—ÏÒÙ‡)); $±îòº† = Model($íÏóşì€[598])->where($›îº²Æ)->count($íÏóşì€[1765]); $›îº²Æ[$íÏóşì€[33]] = $íÏóşì€[1906]; $£Œı’¹› = Model($íÏóşì€[1907])->where($›îº²Æ)->count($íÏóşì€[1908]); $ü¬ª½ªæ = array($íÏóşì€[255] => $¹äÈ·§Ÿ, $íÏóşì€[831] => (int) $¤¬­½ş, $íÏóşì€[1893] => (int) $±îòº†, $íÏóşì€[1894] => (int) $£Œı’¹›); return $this->insert($ü¬ª½ªæ); } public function _recordStore($×Ïì—üÁ = '') { $™ûŸÌ»‹ =& $_SERVER[ÆªÈ–¬]; $—„Í¤çÀ = strtotime(date($™ûŸÌ»‹[1905], strtotime($×Ïì—üÁ))); $Â©¬‡µ = array($™ûŸÌ»‹[231] => array($™ûŸÌ»‹[1084], $—„Í¤çÀ)); $¨¿·²Ó = Model($™ûŸÌ»‹[544])->where($Â©¬‡µ)->sum($™ûŸÌ»‹[79]); $Â©¬‡µ[$™ûŸÌ»‹[485]] = 0; $¼·½¯ê = Model($™ûŸÌ»‹[890])->where($Â©¬‡µ)->sum($™ûŸÌ»‹[79]); $Â©¬‡µ[$™ûŸÌ»‹[190]] = 1; $êú‘ÛŒ… = Model($™ûŸÌ»‹[890])->where($Â©¬‡µ)->sum($™ûŸÌ»‹[79]); $Â©¬‡µ[$™ûŸÌ»‹[190]] = 2; $ıü»‘£Œ = Model($™ûŸÌ»‹[890])->where($Â©¬‡µ)->sum($™ûŸÌ»‹[79]); $µÇùÑ†¿ = array($™ûŸÌ»‹[255] => $×Ïì—üÁ, $™ûŸÌ»‹[829] => (int) $¼·½¯ê, $™ûŸÌ»‹[1897] => (int) $¨¿·²Ó, $™ûŸÌ»‹[1898] => (int) $êú‘ÛŒ…, $™ûŸÌ»‹[1899] => (int) $ıü»‘£Œ); return $this->insert($µÇùÑ†¿); } public function trend($ô÷ùû–í, $è¬Ÿ¦Øİ) { $ŞŞ³¶©Ã =& $_SERVER[ÆªÈ–¬]; if (!$this->init($ô÷ùû–í)) { return !1; } $€Ò¯Ùñû = $this->trendList($ô÷ùû–í); if ($€Ò¯Ùñû && $è¬Ÿ¦Øİ != $ŞŞ³¶©Ã[1738]) { $°“ÎÌ’° = $€Ò¯Ùñû[0][$ŞŞ³¶©Ã[255]]; $Ô£¾’í« = $this->validDate($è¬Ÿ¦Øİ, $°“ÎÌ’°); $ÌÄèÇ£º = array(); $î¿ÁÆí = array_to_keyvalue($€Ò¯Ùñû, $ŞŞ³¶©Ã[255]); foreach ($Ô£¾’í« as $“”€æÏ¾) { if (isset($î¿ÁÆí[$“”€æÏ¾])) { $Ï¸Ğ÷Œ¤ = $î¿ÁÆí[$“”€æÏ¾]; } else { $Ï¸Ğ÷Œ¤ = end($€Ò¯Ùñû); $Ï¸Ğ÷Œ¤[$ŞŞ³¶©Ã[255]] = $“”€æÏ¾; if ($ô÷ùû–í == $ŞŞ³¶©Ã[662]) { $Ï¸Ğ÷Œ¤[$ŞŞ³¶©Ã[1893]] = $Ï¸Ğ÷Œ¤[$ŞŞ³¶©Ã[1894]] = 0; } } $ÌÄèÇ£º[] = $Ï¸Ğ÷Œ¤; } $€Ò¯Ùñû = $ÌÄèÇ£º; } $¿ åÛØ = array($ŞŞ³¶©Ã[662] => array($ŞŞ³¶©Ã[831] => LNG($ŞŞ³¶©Ã[1909]), $ŞŞ³¶©Ã[1893] => LNG($ŞŞ³¶©Ã[1910]), $ŞŞ³¶©Ã[1894] => LNG($ŞŞ³¶©Ã[1911])), $ŞŞ³¶©Ã[1895] => array($ŞŞ³¶©Ã[829] => LNG($ŞŞ³¶©Ã[1912]), $ŞŞ³¶©Ã[1897] => LNG($ŞŞ³¶©Ã[1913]), $ŞŞ³¶©Ã[1898] => LNG($ŞŞ³¶©Ã[1914]), $ŞŞ³¶©Ã[1899] => LNG($ŞŞ³¶©Ã[1915]))); $ÖŸõÅ = array($ŞŞ³¶©Ã[662] => $ŞŞ³¶©Ã[1916], $ŞŞ³¶©Ã[1895] => $ŞŞ³¶©Ã[79]); if (empty($€Ò¯Ùñû)) { $“”€æÏ¾ = date($ŞŞ³¶©Ã[1900], strtotime($ŞŞ³¶©Ã[1901])); $ĞßÜóáÔ = array($ŞŞ³¶©Ã[255] => $“”€æÏ¾); foreach ($¿ åÛØ[$ô÷ùû–í] as $—ƒ·Ñˆ => $ï¡Ë‡Š) { $ĞßÜóáÔ[$—ƒ·Ñˆ] = 0; } $€Ò¯Ùñû[] = $ĞßÜóáÔ; } $ğ®òœŠ = array(); foreach ($€Ò¯Ùñû as $ï¡Ë‡Š) { if ($ô÷ùû–í == $ŞŞ³¶©Ã[1895] && $ï¡Ë‡Š[$ŞŞ³¶©Ã[1897]] > $ï¡Ë‡Š[$ŞŞ³¶©Ã[829]]) { $ï¡Ë‡Š[$ŞŞ³¶©Ã[1897]] = $ï¡Ë‡Š[$ŞŞ³¶©Ã[829]]; } foreach ($¿ åÛØ[$ô÷ùû–í] as $—ƒ·Ñˆ => $Öà¨Ö) { $Ï¸Ğ÷Œ¤ = array($ŞŞ³¶©Ã[255] => $ï¡Ë‡Š[$ŞŞ³¶©Ã[255]], $ŞŞ³¶©Ã[1651] => $Öà¨Ö); $Ï¸Ğ÷Œ¤[$ÖŸõÅ[$ô÷ùû–í]] = isset($ï¡Ë‡Š[$—ƒ·Ñˆ]) ? $ï¡Ë‡Š[$—ƒ·Ñˆ] : 0; $ğ®òœŠ[] = $Ï¸Ğ÷Œ¤; } } return $ğ®òœŠ; } public function validDate($Ó¿ÕÂÁÇ, $°–÷·£¨) { $³‚ı¹Ù‹ =& $_SERVER[ÆªÈ–¬]; $±¯¹êå = date($³‚ı¹Ù‹[1900], strtotime($³‚ı¹Ù‹[1901])); $œÔßÒç¡ = array($±¯¹êå); switch ($Ó¿ÕÂÁÇ) { case $³‚ı¹Ù‹[1745]: $¥‰ÁáÈŞ = mktime(0, 0, 0, date($³‚ı¹Ù‹[1917]), date($³‚ı¹Ù‹[1442]) - date($³‚ı¹Ù‹[1532]) + 7 - 7, date($³‚ı¹Ù‹[1918])); $İ¦‘ªÈ¸ = 0; do { $Ä †æØ = date($³‚ı¹Ù‹[1900], $¥‰ÁáÈŞ - 3600 * 24 * 7 * $İ¦‘ªÈ¸); $œÔßÒç¡[] = $Ä †æØ; $İ¦‘ªÈ¸++; } while ($°–÷·£¨ < $Ä †æØ); break; case $³‚ı¹Ù‹[1743]: $İ¦‘ªÈ¸ = 1; do { $Ûç‘É‰á = date($³‚ı¹Ù‹[1919], strtotime("\x2d\x20{$İ¦‘ªÈ¸}\x20\x6d\x6f\x6e\x74\x68\x73")); $œÔßÒç¡[] = $Ûç‘É‰á; $İ¦‘ªÈ¸++; } while ($°–÷·£¨ < $Ûç‘É‰á); break; case $³‚ı¹Ù‹[1920]: $™¡œ–§ = (int) date($³‚ı¹Ù‹[1918], strtotime($°–÷·£¨)); $›ºÙ¤Òí = (int) date($³‚ı¹Ù‹[1918]); if ($™¡œ–§ >= $›ºÙ¤Òí) { break; } for ($™¡œ–§; $™¡œ–§ < $›ºÙ¤Òí; $™¡œ–§++) { $œÔßÒç¡[] = $™¡œ–§ . $³‚ı¹Ù‹[1921]; } break; default: break; } if ($°–÷·£¨ > end($œÔßÒç¡)) { array_pop($œÔßÒç¡); } sort($œÔßÒç¡); return $œÔßÒç¡; } public function listTable($Ûß…æı) { $æàó™°õ = ucfirst($Ûß…æı); return Model($æàó™°õ)->listData(); } public function option($Á´Ù„‘) { $ÅØ‘»»º = $_SERVER[ÆªÈ–¬][1922] . ucfirst($Á´Ù„‘); return $this->{$ÅØ‘»»º}(); } private function optionUser() { $¨Ü =& $_SERVER[ÆªÈ–¬]; $íü‰ŒöÁ = Model($¨Ü[598])->count($¨Ü[1765]); $Š‰©Öš‰ = Model($¨Ü[598])->where($¨Ü[1923])->count($¨Ü[1765]); $õ¬”ã®‚ = intval($GLOBALS[$¨Ü[6]][$¨Ü[425]][$¨Ü[1711]]) / 3600; $Ø çë­ = strtotime("\x2d{$õ¬”ã®‚}\x20\150\x6f\165\162\163"); $ƒ–µˆå’ = strtotime(date($¨Ü[1904])); if ($Ø çë­ < $ƒ–µˆå’) { $Ø çë­ = $ƒ–µˆå’; } $ƒ™—™Ûã = array($¨Ü[1924] => array($¨Ü[1085], $Ø çë­)); $¯ôÄ«  = (int) Model($¨Ü[598])->where($ƒ™—™Ûã)->count($¨Ü[1765]); if (!$¯ôÄ« ) { $¯ôÄ«  = 1; } $ƒ™—™Ûã = array($¨Ü[1924] => array($¨Ü[1085], $ƒ–µˆå’)); $“¢Ò™™ = Model($¨Ü[598])->where($ƒ™—™Ûã)->count($¨Ü[1765]); return array($¨Ü[824] => (int) $íü‰ŒöÁ, $¨Ü[1925] => (int) ($íü‰ŒöÁ - $Š‰©Öš‰), $¨Ü[1926] => (int) $Š‰©Öš‰, $¨Ü[1927] => (int) $“¢Ò™™, $¨Ü[1928] => $¯ôÄ« ); } private function optionFile() { $•ÒÙà =& $_SERVER[ÆªÈ–¬]; $ÙñªÎå« = $this->sourceSize(); $¾›¥¸Ó¡ = $ÙñªÎå«[$•ÒÙà[79]]; $Õ¾˜…ÑÖ = $ÙñªÎå«[$•ÒÙà[1897]]; $³ê–¼í = Model($•ÒÙà[890])->where(array($•ÒÙà[485] => 0))->count($•ÒÙà[193]); $ Š‚Æˆé = array($•ÒÙà[485] => 0, $•ÒÙà[231] => array($•ÒÙà[1085], strtotime(date($•ÒÙà[1904])))); $õ×çı¦ƒ = Model($•ÒÙà[890])->where($ Š‚Æˆé)->sum($•ÒÙà[79]); $ß€Àï“ş = Model($•ÒÙà[890])->where($ Š‚Æˆé)->count($•ÒÙà[193]); return array($•ÒÙà[829] => $¾›¥¸Ó¡, $•ÒÙà[1897] => $Õ¾˜…ÑÖ, $•ÒÙà[1929] => $¾›¥¸Ó¡ - $Õ¾˜…ÑÖ, $•ÒÙà[1930] => (int) $õ×çı¦ƒ, $•ÒÙà[831] => (int) $³ê–¼í, $•ÒÙà[1931] => (int) $ß€Àï“ş); } private function optionAccess() { $Äí´ÑÚ€ =& $_SERVER[ÆªÈ–¬]; return array($Äí´ÑÚ€[824] => $this->typeLogCnt(), $Äí´ÑÚ€[110] => $this->typeLogCnt($Äí´ÑÚ€[110]), $Äí´ÑÚ€[525] => $this->typeLogCnt($Äí´ÑÚ€[525]), $Äí´ÑÚ€[1932] => $this->typeLogCnt($Äí´ÑÚ€[1932]), $Äí´ÑÚ€[1933] => $this->typeLogCnt($Äí´ÑÚ€[1933]), $Äí´ÑÚ€[662] => $this->typeLogCnt($Äí´ÑÚ€[12], $Äí´ÑÚ€[1908])); } private function typeLogCnt($šàÈú¨õ = '', $ğïõÙ»é = "\x69\144") { $…§–²æ =& $_SERVER[ÆªÈ–¬]; $‘´œƒŸ¡ = array($…§–²æ[110] => array($…§–²æ[1934], $…§–²æ[1935]), $…§–²æ[525] => array($…§–²æ[1936], $…§–²æ[1937]), $…§–²æ[1932] => array($…§–²æ[1938], $…§–²æ[1939], $…§–²æ[1940]), $…§–²æ[1933] => array($…§–²æ[1941], $…§–²æ[1942]), $…§–²æ[1943] => array($…§–²æ[1944], $…§–²æ[1945], $…§–²æ[1946])); $Ğ¹ÖÖ… = strtotime(date($…§–²æ[1904])); $ôëé²£÷ = array($…§–²æ[231] => array($…§–²æ[1085], $Ğ¹ÖÖ…)); if ($šàÈú¨õ) { $ôëé²£÷[$…§–²æ[33]] = array($…§–²æ[7], $‘´œƒŸ¡[$šàÈú¨õ]); } $½‘ä¾» = Model($…§–²æ[1907])->where($ôëé²£÷)->count($ğïõÙ»é); return (int) $½‘ä¾»; } private function optionServer() { $ëÆÏ°€ü =& $_SERVER[ÆªÈ–¬]; $ÎÎÏŒË = $this->diskDriver(); $ÙËğÙ = KodIO::defaultDriver(); $æÎ‘Äå“ = array($ëÆÏ°€ü[883] => $ÙËğÙ[$ëÆÏ°€ü[475]]); $Öº·¾•— = Model($ëÆÏ°€ü[544])->where($æÎ‘Äå“)->sum($ëÆÏ°€ü[79]); $ßïÜÈ° = explode($ëÆÏ°€ü[53], $_SERVER[$ëÆÏ°€ü[147]]); $×’ƒ‡×Û = $ßïÜÈ°[0]; $œ¨ô®ˆ = $GLOBALS[$ëÆÏ°€ü[6]][$ëÆÏ°€ü[21]]; $¿½øªñƒ = $œ¨ô®ˆ[$ëÆÏ°€ü[1047]]; if ($¿½øªñƒ == $ëÆÏ°€ü[1035]) { $¼âÔç‚· = explode($ëÆÏ°€ü[1361], $œ¨ô®ˆ[$ëÆÏ°€ü[1046]]); $¿½øªñƒ = $¼âÔç‚·[0]; } if ($¿½øªñƒ == $ëÆÏ°€ü[983] || $¿½øªñƒ == $ëÆÏ°€ü[870]) { $õ¯×ùåû = Model()->db()->query($ëÆÏ°€ü[1947]); $œ€¯Ğ»Ú = $õ¯×ùåû[0] && isset($õ¯×ùåû[0][$ëÆÏ°€ü[1650]]) ? $õ¯×ùåû[0][$ëÆÏ°€ü[1650]] : 0; $¿½øªñƒ = $ëÆÏ°€ü[1948] . ($œ€¯Ğ»Ú ? $ëÆÏ°€ü[8] . $œ€¯Ğ»Ú : $ëÆÏ°€ü[12]); } $äÖè™Û = $GLOBALS[$ëÆÏ°€ü[6]][$ëÆÏ°€ü[425]][$ëÆÏ°€ü[900]]; return array($ëÆÏ°€ü[1949] => $ÎÎÏŒË ? $ÎÎÏŒË[$ëÆÏ°€ü[1950]] : 0, $ëÆÏ°€ü[1951] => $ÎÎÏŒË ? $ÎÎÏŒË[$ëÆÏ°€ü[1952]] : 0, $ëÆÏ°€ü[1953] => (int) $ÙËğÙ[$ëÆÏ°€ü[1950]] * 1024 * 1024 * 1024, $ëÆÏ°€ü[1954] => (int) $Öº·¾•—, $ëÆÏ°€ü[1955] => ucfirst($×’ƒ‡×Û), $ëÆÏ°€ü[1956] => $ëÆÏ°€ü[1957] . PHP_VERSION, $ëÆÏ°€ü[1958] => phpBuild64() ? 64 : 32, $ëÆÏ°€ü[823] => str_replace($ëÆÏ°€ü[1204], $ëÆÏ°€ü[1063], $¿½øªñƒ), $ëÆÏ°€ü[425] => ucfirst($äÖè™Û), $ëÆÏ°€ü[32] => $_SERVER[$ëÆÏ°€ü[1959]]); } private function diskDriver() { $Š¢¾„ =& $_SERVER[ÆªÈ–¬]; $ÕïÎŸÌí = $Š¢¾„[8]; $âÃÅµÜç = $GLOBALS[$Š¢¾„[6]][$Š¢¾„[1378]] == $Š¢¾„[1379]; if ($âÃÅµÜç) { $ÕïÎŸÌí = $Š¢¾„[1960]; if (function_exists($Š¢¾„[1961])) { exec($Š¢¾„[1962], $Õˆ”™ú); $ÕïÎŸÌí = $Õˆ”™ú[1] . $Š¢¾„[8]; } } if (!file_exists($ÕïÎŸÌí)) { return; } if (!function_exists($Š¢¾„[1963])) { return; } $…Éİ¹±ñ = @disk_total_space($ÕïÎŸÌí); $Î€…šî² = $…Éİ¹±ñ - @disk_free_space($ÕïÎŸÌí); return array($Š¢¾„[1950] => $…Éİ¹±ñ, $Š¢¾„[1952] => $Î€…šî²); } public function fileChart($ÀåÓ³ì) { $¤ÜÄÏ·© =& $_SERVER[ÆªÈ–¬]; if (isset($ÀåÓ³ì[$¤ÜÄÏ·©[1765]])) { return Model($¤ÜÄÏ·©[890])->userFileTypeProfile($ÀåÓ³ì[$¤ÜÄÏ·©[1765]]); } if (isset($ÀåÓ³ì[$¤ÜÄÏ·©[1964]])) { return Model($¤ÜÄÏ·©[890])->groupFileTypeProfile($ÀåÓ³ì[$¤ÜÄÏ·©[1964]]); } $¢ì˜üş³ = $this->sourceSize(); $¿ğ¨¹Ö = array($¤ÜÄÏ·©[192] => 0, $¤ÜÄÏ·©[190] => 1); $éê‚´û² = Model($¤ÜÄÏ·©[890])->where($¿ğ¨¹Ö)->sum($¤ÜÄÏ·©[79]); $¿ğ¨¹Ö[$¤ÜÄÏ·©[190]] = 2; $¸ãËØªÌ = Model($¤ÜÄÏ·©[890])->where($¿ğ¨¹Ö)->sum($¤ÜÄÏ·©[79]); return array($¤ÜÄÏ·©[829] => $¢ì˜üş³[$¤ÜÄÏ·©[79]], $¤ÜÄÏ·©[1897] => $¢ì˜üş³[$¤ÜÄÏ·©[1897]], $¤ÜÄÏ·©[1898] => (int) $éê‚´û², $¤ÜÄÏ·©[1899] => (int) $¸ãËØªÌ); } private function sourceSize() { $ö¨›¾ıÁ =& $_SERVER[ÆªÈ–¬]; $æù¤œÂ‰ = Model($ö¨›¾ıÁ[890])->where(array($ö¨›¾ıÁ[485] => 0))->sum($ö¨›¾ıÁ[79]); $Êˆ‰Åš = Model($ö¨›¾ıÁ[544])->sum($ö¨›¾ıÁ[79]); if ($Êˆ‰Åš > $æù¤œÂ‰) { $Êˆ‰Åš = $æù¤œÂ‰; } return array($ö¨›¾ıÁ[79] => (int) $æù¤œÂ‰, $ö¨›¾ıÁ[1897] => (int) $Êˆ‰Åš); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $öôÒÀ¯Ğ =& $_SERVER[ÆªÈ–¬]; $³£µûĞÆ = array(array($öôÒÀ¯Ğ[494] => LNG($öôÒÀ¯Ğ[1965]), $öôÒÀ¯Ğ[1966] => $öôÒÀ¯Ğ[1967], $öôÒÀ¯Ğ[1968] => 1, $öôÒÀ¯Ğ[1969] => 1, $öôÒÀ¯Ğ[1970] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($öôÒÀ¯Ğ[494] => LNG($öôÒÀ¯Ğ[1971]), $öôÒÀ¯Ğ[1966] => $öôÒÀ¯Ğ[1972], $öôÒÀ¯Ğ[1968] => 2, $öôÒÀ¯Ğ[1969] => 1, $öôÒÀ¯Ğ[1970] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($öôÒÀ¯Ğ[494] => LNG($öôÒÀ¯Ğ[1973]), $öôÒÀ¯Ğ[1966] => $öôÒÀ¯Ğ[1974], $öôÒÀ¯Ğ[1968] => 3, $öôÒÀ¯Ğ[1969] => 1, $öôÒÀ¯Ğ[1970] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($öôÒÀ¯Ğ[494] => LNG($öôÒÀ¯Ğ[1975]), $öôÒÀ¯Ğ[1966] => $öôÒÀ¯Ğ[1976], $öôÒÀ¯Ğ[1968] => 4, $öôÒÀ¯Ğ[1969] => 1, $öôÒÀ¯Ğ[1970] => self::AUTH_SHOW | self::AUTH_VIEW), array($öôÒÀ¯Ğ[494] => LNG($öôÒÀ¯Ğ[1977]), $öôÒÀ¯Ğ[1966] => $öôÒÀ¯Ğ[1978], $öôÒÀ¯Ğ[1968] => 5, $öôÒÀ¯Ğ[1969] => 1, $öôÒÀ¯Ğ[1970] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($öôÒÀ¯Ğ[494] => LNG($öôÒÀ¯Ğ[1979]), $öôÒÀ¯Ğ[1966] => $öôÒÀ¯Ğ[1980], $öôÒÀ¯Ğ[1968] => 6, $öôÒÀ¯Ğ[1969] => 1, $öôÒÀ¯Ğ[1970] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($öôÒÀ¯Ğ[494] => LNG($öôÒÀ¯Ğ[1981]), $öôÒÀ¯Ğ[1966] => $öôÒÀ¯Ğ[1982], $öôÒÀ¯Ğ[1968] => 7, $öôÒÀ¯Ğ[1969] => 1, $öôÒÀ¯Ğ[1970] => 0)); return $³£µûĞÆ; } public static function authCheck($—õ¿áÓ, $²ƒöÃëÀ) { $¤’¸çÎô =& $_SERVER[ÆªÈ–¬]; $—õ¿áÓ = intval($—õ¿áÓ); if (KodUser::isRoot() && $GLOBALS[$¤’¸çÎô[6]][$¤’¸çÎô[1983]]) { return !0; } if ($—õ¿áÓ <= 0) { return !1; } if (($—õ¿áÓ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—õ¿áÓ & $²ƒöÃëÀ); } public static function authCheckShow($ŠÛºù¥í) { return self::authCheck($ŠÛºù¥í, self::AUTH_SHOW); } public static function authCheckView($·Ò©ÒÏ) { return self::authCheck($·Ò©ÒÏ, self::AUTH_VIEW); } public static function authCheckDownload($æÌÃîÌŸ) { return self::authCheck($æÌÃîÌŸ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ã£Ù¯®å) { return self::authCheck($ã£Ù¯®å, self::AUTH_UPLOAD); } public static function authCheckEdit($ËÏÅïğ) { return self::authCheck($ËÏÅïğ, self::AUTH_EDIT); } public static function authCheckRemove($œ¼Õ—ÀÊ) { return self::authCheck($œ¼Õ—ÀÊ, self::AUTH_REMOVE); } public static function authCheckShare($İ³Ê‘µì) { return self::authCheck($İ³Ê‘µì, self::AUTH_SHARE); } public static function authCheckComment($ÕöÛõ´÷) { return self::authCheck($ÕöÛõ´÷, self::AUTH_COMMENT); } public static function authCheckEvent($úˆ•¾ì‡) { return self::authCheck($úˆ•¾ì‡, self::AUTH_EVENT); } public static function authCheckRoot($øÊïö‰î) { return self::authCheck($øÊïö‰î, self::AUTH_ROOT); } public static function authCheckAction($êµ’äºƒ, $²äŞò¤ä) { $ÃµÙÅÙ„ =& $_SERVER[ÆªÈ–¬]; $ğ´ãˆ  = array($ÃµÙÅÙ„[1984] => self::AUTH_VIEW, $ÃµÙÅÙ„[1272] => self::AUTH_DOWNLOAD, $ÃµÙÅÙ„[110] => self::AUTH_UPLOAD, $ÃµÙÅÙ„[1933] => self::AUTH_EDIT, $ÃµÙÅÙ„[1932] => self::AUTH_REMOVE, $ÃµÙÅÙ„[1943] => self::AUTH_SHARE, $ÃµÙÅÙ„[430] => self::AUTH_COMMENT, $ÃµÙÅÙ„[1753] => self::AUTH_EVENT, $ÃµÙÅÙ„[1985] => self::AUTH_ROOT); if (!isset($ğ´ãˆ [$²äŞò¤ä])) { return; } $›Â˜·¢á = $ğ´ãˆ [$²äŞò¤ä]; $êµ’äºƒ = intval($êµ’äºƒ); if ($êµ’äºƒ <= 0) { return !1; } if (($êµ’äºƒ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($êµ’äºƒ & $›Â˜·¢á); } public static function authDisable($×û¥ıÃò, $“Œ¬ÒóÒ) { if (intval($×û¥ıÃò) <= 0) { return 0; } return intval($×û¥ıÃò) & ~$“Œ¬ÒóÒ; } public $optionType = "\123\171\163\x74\145\155\56\163\157\165\x72\143\x65\x41\165\x74\x68\x4c\151\x73\x74"; public $field = array("\156\141\155\145", "\x61\x75\x74\150", "\x6c\141\142\145\x6c", "\x64\x69\x73\160\154\141\x79", "\x73\x79\163\164\145\155", "\163\x6f\162\x74"); public function initData() { $â¨ÄÀ” = $this->authDefault(); foreach ($â¨ÄÀ” as $Ï ñéí¶) { $this->add($Ï ñéí¶); } } public function findAuth($ºö®€‰«, $ç¶Ñ«ã) { $í®×İıÏ =& $_SERVER[ÆªÈ–¬]; $†İĞÌ¢ = parent::listData(); foreach ($†İĞÌ¢ as $«òß·ğÇ) { $ªµíç¥¨ = intval($«òß·ğÇ[$í®×İıÏ[487]]); if ($ªµíç¥¨ <= 0 || $«òß·ğÇ[$í®×İıÏ[1986]] == 0) { continue; } if (($ªµíç¥¨ & $ºö®€‰«) != $ºö®€‰«) { continue; } if (($ªµíç¥¨ & $ç¶Ñ«ã) != 0) { continue; } return $«òß·ğÇ[$í®×İıÏ[475]]; } return !1; } public function findAuthReadOnly() { $åèııÉš = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¬¬ãê = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($åèııÉš, $¬¬ãê); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÏøÍˆ“ =& $_SERVER[ÆªÈ–¬]; $Ïö¼ú¸¥ = parent::listData(); $˜üà˜Š³ = !1; foreach ($Ïö¼ú¸¥ as $ªâ¥•¹‰) { if ($ªâ¥•¹‰[$ÏøÍˆ“[487]] <= 0 || $ªâ¥•¹‰[$ÏøÍˆ“[1986]] == $ÏøÍˆ“[228]) { continue; } if (!$˜üà˜Š³) { $˜üà˜Š³ = $ªâ¥•¹‰; continue; } if ($˜üà˜Š³[$ÏøÍˆ“[487]] > $ªâ¥•¹‰[$ÏøÍˆ“[487]]) { $˜üà˜Š³ = $ªâ¥•¹‰; } } return $˜üà˜Š³ ? $˜üà˜Š³[$ÏøÍˆ“[475]] : $ÏøÍˆ“[12]; } public function listData($äªøïËû = false, $ÔŠµéõ¨ = "\163\157\x72\x74", $´ÖœÇô” = false) { return parent::listData($äªøïËû, $ÔŠµéõ¨, $´ÖœÇô”); } public function update($ëˆÚäº¯, $’ìÔÙâ) { $ºö½¤´ç =& $_SERVER[ÆªÈ–¬]; $Ö¶Áİ’– = parent::listData($ëˆÚäº¯); $äĞˆ»ª¸ = $this->findByName($’ìÔÙâ[$ºö½¤´ç[32]]); if (!$Ö¶Áİ’– || $äĞˆ»ª¸ && $äĞˆ»ª¸[$ºö½¤´ç[475]] != $Ö¶Áİ’–[$ºö½¤´ç[475]]) { return !1; } $this->filterAuth($’ìÔÙâ[$ºö½¤´ç[487]]); return parent::update($ëˆÚäº¯, $’ìÔÙâ); } public function remove($®éÌ¦“Õ) { $Ôïû¾± = parent::listData($®éÌ¦“Õ); if (!$Ôïû¾± || $Ôïû¾±[$_SERVER[ÆªÈ–¬][191]]) { return !1; } return parent::remove($®éÌ¦“Õ); } public function add($´©±ÓŒ = array()) { $Î³œì˜ =& $_SERVER[ÆªÈ–¬]; if ($this->findByName($´©±ÓŒ[$Î³œì˜[32]])) { return !1; } $ß¦ÄÌ™Ë = array($Î³œì˜[32] => $Î³œì˜[12], $Î³œì˜[487] => 1, $Î³œì˜[1987] => $Î³œì˜[1974], $Î³œì˜[1986] => 1, $Î³œì˜[191] => 0, $Î³œì˜[1988] => 0); $´©±ÓŒ = array_merge($ß¦ÄÌ™Ë, $´©±ÓŒ); $´©±ÓŒ[$Î³œì˜[1988]] = $this->getSort(); $this->filterAuth($´©±ÓŒ[$Î³œì˜[487]]); return parent::insert($´©±ÓŒ); } private function getSort() { $•Ìè¼” =& $_SERVER[ÆªÈ–¬]; $¹³§ù—® = parent::listData(); $ñõÉéË = array_to_keyvalue($¹³§ù—®, $•Ìè¼”[12], $•Ìè¼”[1988]); return empty($ñõÉéË) ? 0 : max($ñõÉéË) + 1; } private function filterAuth(&$ãØ¼†ß) { if (!$ãØ¼†ß) { return; } $Èßœ»“Ä = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $è€²“úü = array(); foreach ($Èßœ»“Ä as $¡Ó—åæ) { if ($ãØ¼†ß & $¡Ó—åæ) { $è€²“úü[] = $¡Ó—åæ; } } if (in_array(self::AUTH_ROOT, $è€²“úü)) { $ãØ¼†ß = array_sum($Èßœ»“Ä); return; } $Ùâ®¹°Ò = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($è€²“úü as $¡Ó—åæ) { if (isset($Ùâ®¹°Ò[$¡Ó—åæ])) { $è€²“úü = array_merge($è€²“úü, $Ùâ®¹°Ò[$¡Ó—åæ]); } } $è€²“úü[] = self::AUTH_SHOW; $ãØ¼†ß = array_sum(array_unique($è€²“úü)); } public function sort($ƒà‚•áï, $ç¬ éµÕ) { return parent::update($ƒà‚•áï, $ç¬ éµÕ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\142\x61\143\x6b\x75\160\x4c\151\x73\164"; public $field = array("\151\x6f", "\x6e\x61\x6d\145", "\x73\x74\141\x74\165\x73", "\143\x6f\156\x74\x65\156\x74", "\x6d\x61\156\165\141\x6c", "\162\x65\163\165\154\x74", "\164\x69\155\x65\x46\x72\x6f\x6d", "\164\x69\x6d\145\x54\157"); public function config() { $àã×İ– =& $_SERVER[ÆªÈ–¬]; Action($àã×İ–[1989])->taskInit(); $Ü»ÚíÊ± = Model($àã×İ–[836])->get($àã×İ–[849]); $Ü»ÚíÊ± = json_decode($Ü»ÚíÊ±, !0); $Ü»ÚíÊ± = is_array($Ü»ÚíÊ±) ? $Ü»ÚíÊ± : array(); $this->parseContent($Ü»ÚíÊ±); unset($Ü»ÚíÊ±[$àã×İ–[1735]]); Model($àã×İ–[1734])->cacheClear(); $¤ØĞÍ«é = $àã×İ–[1990]; $ä¹ò¼Éí = Model($àã×İ–[1991])->findByKey($àã×İ–[1753], $¤ØĞÍ«é); if (!$ä¹ò¼Éí) { $ä¹ò¼Éí = array(); } if (isset($ä¹ò¼Éí[$àã×İ–[206]])) { $ä¹ò¼Éí[$àã×İ–[206]] = json_decode($ä¹ò¼Éí[$àã×İ–[206]], !0); } if (isset($Ü»ÚíÊ±[$àã×İ–[206]])) { $ä¹ò¼Éí[$àã×İ–[206]][$àã×İ–[1738]] = $Ü»ÚíÊ±[$àã×İ–[206]]; unset($Ü»ÚíÊ±[$àã×İ–[206]]); } return array_merge($ä¹ò¼Éí, $Ü»ÚíÊ±); } public function listData($°³¦ÕÔµ = false, $°Ï˜‚ß¤ = "\x6d\157\144\151\146\x79\124\151\x6d\145", $Š«Şç®Í = false) { $¥ÕÏÏ¦ = parent::listData($°³¦ÕÔµ, $°Ï˜‚ß¤, !0); if (!$¥ÕÏÏ¦) { return $¥ÕÏÏ¦; } if ($°³¦ÕÔµ) { $¥ÕÏÏ¦ = array($¥ÕÏÏ¦); } foreach ($¥ÕÏÏ¦ as &$ôï•°³¬) { $this->parseContent($ôï•°³¬); } return $°³¦ÕÔµ ? $¥ÕÏÏ¦[0] : $¥ÕÏÏ¦; } public function parseContent(&$ÖÏôÀô) { $¿’Õè€¡ =& $_SERVER[ÆªÈ–¬]; $™ã‘¾Å– = _get($ÖÏôÀô, $¿’Õè€¡[171], $¿’Õè€¡[91]); if (!in_array($™ã‘¾Å–, array($¿’Õè€¡[842], $¿’Õè€¡[1204]))) { $ÖÏôÀô[$¿’Õè€¡[171]] = $™ã‘¾Å– == $¿’Õè€¡[91] ? $¿’Õè€¡[1204] : $¿’Õè€¡[842]; } } public function lastItem() { $¯÷¾œ = $this->listData(); return !empty($¯÷¾œ[0]) ? $¯÷¾œ[0] : null; } public function kill($íµ«î‹È) { $Éè†ñÒ¥ =& $_SERVER[ÆªÈ–¬]; $ŸãĞâ…” = $this->listData($íµ«î‹È); if (!$ŸãĞâ…” || empty($ŸãĞâ…”[$Éè†ñÒ¥[32]])) { return !0; } Task::kill($Éè†ñÒ¥[848]); Task::kill($Éè†ñÒ¥[866]); Task::kill($Éè†ñÒ¥[875]); $œç¬ŞÀ‰ = $ŸãĞâ…”[$Éè†ñÒ¥[32]]; $åØÖ”ª = TEMP_FILES . $Éè†ñÒ¥[845] . $œç¬ŞÀ‰ . $Éè†ñÒ¥[8]; IO::remove($åØÖ”ª, !1); return $this->remove($íµ«î‹È); } public function remove($¦ƒÑ¹î©) { $¤øº÷õ‚ = $this->listData($¦ƒÑ¹î©); if (!$¤øº÷õ‚) { return !0; } return $this->backupRemove($¤øº÷õ‚); } private function backupRemove($œ§Ôèçå) { parent::remove($œ§Ôèçå[$_SERVER[ÆªÈ–¬][475]]); $–×üÓ¨ = $this->backupPath($œ§Ôèçå); IO::remove($–×üÓ¨, !1); return !0; } private function backupPath($ãŞÎ¼²) { $·öºú±÷ =& $_SERVER[ÆªÈ–¬]; $Ò¨ì¢öï = $ãŞÎ¼²[$·öºú±÷[32]]; $ò–½ˆçİ = Model($·öºú±÷[836])->get($·öºú±÷[837]); $¿Ü½èÉî = substr(md5($·öºú±÷[838] . $ò–½ˆçİ . $Ò¨ì¢öï), 0, 8); return "\173\x69\x6f\72{$ãŞÎ¼²[$·öºú±÷[818]]}\175\57\x64\x61\164\141\142\x61\x73\145\57\x62\x61\x63\x6b\165\160\x2f" . $Ò¨ì¢öï . $·öºú±÷[11] . $¿Ü½èÉî; } public function start() { $Ùµşî³ =& $_SERVER[ÆªÈ–¬]; if ($GLOBALS[$Ùµşî³[6]][$Ùµşî³[92]][$Ùµşî³[1992]] != $Ùµşî³[91]) { return !0; } $ô›Ãóé = $this->config(); if (!$ô›Ãóé || $ô›Ãóé[$Ùµşî³[1735]] != $Ùµşî³[91]) { return !1; } if ($ô›Ãóé[$Ùµşî³[171]] == $Ùµşî³[842]) { $ö÷ÙÜï = Model($Ùµşî³[836])->get($Ùµşî³[1317]); if ($ö÷ÙÜï == $Ùµşî³[1318]) { $ô›Ãóé[$Ùµşî³[171]] = $Ùµşî³[1204]; } } $¥¿©ŞÏ = $this->process(); foreach ($¥¿©ŞÏ as $±ÜŒ¤¥Ç) { if ($±ÜŒ¤¥Ç) { return Task::restart($±ÜŒ¤¥Ç[$Ùµşî³[475]]); } } $èàéµ = new Backup(); $ÌùÛ§¾ = $èàéµ->db(); if ($ÌùÛ§¾) { $ÌùÛ§¾ = $èàéµ->dbFile(); if ($ÌùÛ§¾ && $ô›Ãóé[$Ùµşî³[171]] == $Ùµşî³[842]) { $ÌùÛ§¾ = $èàéµ->file(); } } Backup::set(array($Ùµşî³[816] => 1, $Ùµşî³[827] => time())); return !0; } public function process() { $–›îúË› =& $_SERVER[ÆªÈ–¬]; $øİ²ÇĞä = array($–›îúË›[823] => Task::get($–›îúË›[848]), $–›îúË›[828] => Task::get($–›îúË›[866]), $–›îúË›[230] => Task::get($–›îúË›[875])); $¢§²¢ÃÔ = !1; foreach ($øİ²ÇĞä as &$Öá“ã) { if ($¢§²¢ÃÔ) { $Öá“ã = !1; continue; } if ($Öá“ã) { $Íüëõ¯î = intval(_get($Öá“ã, $–›îúË›[1770], 0)); if (time() - $Íüëõ¯î > 7200) { Task::kill($Öá“ã[$–›îúË›[475]]); $¢§²¢ÃÔ = !0; $Öá“ã = !1; } } } return $øİ²ÇĞä; } public function restore() { $†¹îğá® =& $_SERVER[ÆªÈ–¬]; ActionCall($†¹îğá®[1131], !0, 1); ActionCall($†¹îğá®[1131], !0, 0); } } goto EÒ®ªŸëÒË; eó×ÃÊê™Í: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‡ãÕ—ôâ, $ÔÕè÷×æ = 5.0) { if (!$‡ãÕ—ôâ) { return; } $óšÊ†…Ò = Cache::get($‡ãÕ—ôâ); if (!$óšÊ†…Ò || timeFloat() - floatVal($óšÊ†…Ò) >= $ÔÕè÷×æ) { Cache::set($‡ãÕ—ôâ, timeFloat(), $ÔÕè÷×æ * 10); return !0; } return !1; } public static function timeLimitCall($şÛ–¥×ì, $á‡İœÅ, $Ëó€¸œ, $ÄÁ½Ş = 5.0) { $ÃÄ†»ñÃ =& $_SERVER[ÆªÈ–¬]; if (!$şÛ–¥×ì || !$á‡İœÅ) { return; } self::$asyncAdd = !0; $‘Ñú‹¤Ù = $ÃÄ†»ñÃ[1871]; $—â×¾ = Cache::get($‘Ñú‹¤Ù, !0); $†§°™áÑ = array($ÃÄ†»ñÃ[1872] => timeFloat(), $ÃÄ†»ñÃ[1873] => timeFloat(), $ÃÄ†»ñÃ[341] => $á‡İœÅ, $ÃÄ†»ñÃ[1863] => $Ëó€¸œ, $ÃÄ†»ñÃ[206] => $ÄÁ½Ş); if (is_array($—â×¾[$şÛ–¥×ì])) { $†§°™áÑ[$ÃÄ†»ñÃ[1873]] = $—â×¾[$şÛ–¥×ì][$ÃÄ†»ñÃ[1873]]; } if (is_array($—â×¾[$şÛ–¥×ì])) { if (timeFloat() - $—â×¾[$şÛ–¥×ì][$ÃÄ†»ñÃ[1872]] < $†§°™áÑ[$ÃÄ†»ñÃ[206]] * 0.3) { return; } $†§°™áÑ[$ÃÄ†»ñÃ[1873]] = $—â×¾[$şÛ–¥×ì][$ÃÄ†»ñÃ[1873]]; } $—â×¾[$şÛ–¥×ì] = $†§°™áÑ; Cache::set($‘Ñú‹¤Ù, $—â×¾, 60); Cache::removeMemory($‘Ñú‹¤Ù); write_log($ÃÄ†»ñÃ[1874] . $şÛ–¥×ì . $ÃÄ†»ñÃ[74] . $á‡İœÅ, $ÃÄ†»ñÃ[197]); } public static function timeLimitCallLoop() { $ÑŸÖËäì =& $_SERVER[ÆªÈ–¬]; $ÑÌÔà®‰ = array($ÑŸÖËäì[1875]); $ÒÂ½óò¥ = in_array(strtolower(ACTION), $ÑÌÔà®‰); if (!$ÒÂ½óò¥ && !self::$asyncAdd) { return; } $ŸÓ¬°Ê = $ÑŸÖËäì[1871]; $éğ›±–Ù = Cache::get($ŸÓ¬°Ê, !0); if (!$éğ›±–Ù || count($éğ›±–Ù) <= 0) { return; } $ö•À­… = !1; $ÈÆ›ô÷è = timeFloat(); $½‘‰ÚŞé = array(); foreach ($éğ›±–Ù as $ˆ›Ã§é  => $Ç£îÃæà) { if ($ÈÆ›ô÷è - $Ç£îÃæà[$ÑŸÖËäì[1873]] > $Ç£îÃæà[$ÑŸÖËäì[206]]) { $ö•À­… = !0; try { Hook::apply($Ç£îÃæà[$ÑŸÖËäì[341]], $Ç£îÃæà[$ÑŸÖËäì[1863]]); write_log($ÑŸÖËäì[1876] . $ˆ›Ã§é  . $ÑŸÖËäì[74] . $Ç£îÃæà[$ÑŸÖËäì[341]] . $ÑŸÖËäì[1877] . ACTION, $ÑŸÖËäì[197]); } catch (Exception $Ø›ÑÆÃ”) { } continue; } $½‘‰ÚŞé[$ˆ›Ã§é ] = $Ç£îÃæà; } if (!$ö•À­…) { return; } if (!$½‘‰ÚŞé) { return Cache::remove($ŸÓ¬°Ê); } Cache::set($ŸÓ¬°Ê, $½‘‰ÚŞé, 60); Cache::removeMemory($ŸÓ¬°Ê); } public static function finished($æİŠÄ­í, $À»Ş×¢) { $ÅÒ„í‚º =& $_SERVER[ÆªÈ–¬]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÅÒ„í‚º[341] => $æİŠÄ­í, $ÅÒ„í‚º[1863] => $À»Ş×¢); } private static function finishedRun() { $ÙÉ­ùµ =& $_SERVER[ÆªÈ–¬]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $îşÚà¿ø) { try { Hook::apply($îşÚà¿ø[$ÙÉ­ùµ[341]], $îşÚà¿ø[$ÙÉ­ùµ[1863]]); } catch (Exception $ƒÈú÷Æ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ğ§Øà§š =& $_SERVER[ÆªÈ–¬]; parent::startAfter(); Hook::bind($ğ§Øà§š[1878], array($this, $ğ§Øà§š[1879])); Hook::bind($ğ§Øà§š[1271], array($this, $ğ§Øà§š[1880])); Hook::bind($ğ§Øà§š[1881], array($this, $ğ§Øà§š[1882])); $üùíÚ‰Ğ =& $this->task; $üùíÚ‰Ğ[$ğ§Øà§š[1883]] = $ğ§Øà§š[1272]; if (!$üùíÚ‰Ğ[$ğ§Øà§š[1651]]) { $üùíÚ‰Ğ[$ğ§Øà§š[1651]] = LNG($ğ§Øà§š[1884]); } } protected function endAfter() { $ˆ­Ñõš­ =& $_SERVER[ÆªÈ–¬]; parent::endAfter(); Hook::unbind($ˆ­Ñõš­[1878], array($this, $ˆ­Ñõš­[1879])); Hook::unbind($ˆ­Ñõš­[1271], array($this, $ˆ­Ñõš­[1880])); Hook::unbind($ˆ­Ñõš­[1881], array($this, $ˆ­Ñõš­[1882])); } public function updateAfter() { $Û…æ§şÑ =& $_SERVER[ÆªÈ–¬]; $Úş¾ú¸Ÿ =& $this->task; if (!$Úş¾ú¸Ÿ[$Û…æ§şÑ[1134]] || !$Úş¾ú¸Ÿ[$Û…æ§şÑ[829]]) { if ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1883]] != $Û…æ§şÑ[389]) { return; } } if ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1883]] == $Û…æ§şÑ[1272]) { $±×ªü” = 0; if ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1818]]) { $±×ªü” = $Úş¾ú¸Ÿ[$Û…æ§şÑ[1819]] / $Úş¾ú¸Ÿ[$Û…æ§şÑ[1818]]; } $Úş¾ú¸Ÿ[$Û…æ§şÑ[1767]] = $±×ªü” * 0.3; } else { if ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1883]] == $Û…æ§şÑ[389]) { $±×ªü” = $Úş¾ú¸Ÿ[$Û…æ§şÑ[1766]] / $Úş¾ú¸Ÿ[$Û…æ§şÑ[1134]]; $Úş¾ú¸Ÿ[$Û…æ§şÑ[1767]] = 0.3 + $±×ªü” * 0.4; } else { if ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1883]] == $Û…æ§şÑ[110]) { $ÚÔ¸¹çŒ = 0; if ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1820]] == $Û…æ§şÑ[110]) { $ÚÔ¸¹çŒ = $Úş¾ú¸Ÿ[$Û…æ§şÑ[1819]]; } $±×ªü” = ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1823]] + $ÚÔ¸¹çŒ) / $Úş¾ú¸Ÿ[$Û…æ§şÑ[829]]; $Úş¾ú¸Ÿ[$Û…æ§şÑ[1767]] = 0.3 + 0.4 + $±×ªü” * 0.3; } } } if ($Úş¾ú¸Ÿ[$Û…æ§şÑ[1767]] > 0) { $ê¸©€µü = timeFloat() - $Úş¾ú¸Ÿ[$Û…æ§şÑ[1769]] - $Úş¾ú¸Ÿ[$Û…æ§şÑ[1772]]; $Úş¾ú¸Ÿ[$Û…æ§şÑ[1773]] = $ê¸©€µü * (1 - $Úş¾ú¸Ÿ[$Û…æ§şÑ[1767]]) / $Úş¾ú¸Ÿ[$Û…æ§şÑ[1767]]; } } public function addFile($ıØª°ıï) { $ãõÕİÍ› =& $_SERVER[ÆªÈ–¬]; $š›Ç£ˆ =& $this->task; $ÀêĞ¬¼÷ = IO::info($ıØª°ıï); $š›Ç£ˆ[$ãõÕİÍ›[1816]] = $ÀêĞ¬¼÷[$ãõÕİÍ›[32]]; $š›Ç£ˆ[$ãõÕİÍ›[1818]] = $ÀêĞ¬¼÷[$ãõÕİÍ›[79]]; $š›Ç£ˆ[$ãõÕİÍ›[1819]] = 0; $š›Ç£ˆ[$ãõÕİÍ›[1136]] = $ãõÕİÍ›[1839]; $š›Ç£ˆ[$ãõÕİÍ›[1820]] = $ãõÕİÍ›[1272]; $š›Ç£ˆ[$ãõÕİÍ›[829]] = $ÀêĞ¬¼÷[$ãõÕİÍ›[79]]; $š›Ç£ˆ[$ãõÕİÍ›[1134]] = 1; $úœŸğĞ° = 0; $š›Ç£ˆ[$ãõÕİÍ›[1827]] = array($ãõÕİÍ›[1828] => $úœŸğĞ° + 1, $ãõÕİÍ›[494] => $ÀêĞ¬¼÷[$ãõÕİÍ›[32]], $ãõÕİÍ›[87] => $ÀêĞ¬¼÷[$ãõÕİÍ›[87]], $ãõÕİÍ›[582] => $ÀêĞ¬¼÷[$ãõÕİÍ›[582]] ? $ÀêĞ¬¼÷[$ãõÕİÍ›[582]] : $ÀêĞ¬¼÷[$ãõÕİÍ›[87]]); $this->update(); } public function zipEvent($ù¡ò­ª, $İš·ıÜ, $ãŠĞóïê, $Ù·Ô¤–˜) { $â©ñôç =& $_SERVER[ÆªÈ–¬]; $íÛûÉ›Š =& $this->task; $íÛûÉ›Š[$â©ñôç[1816]] = get_path_this($İš·ıÜ); $íÛûÉ›Š[$â©ñôç[1818]] = $Ù·Ô¤–˜; $íÛûÉ›Š[$â©ñôç[1819]] = $ãŠĞóïê; $íÛûÉ›Š[$â©ñôç[1136]] = $ù¡ò­ª == $â©ñôç[1885] ? $â©ñôç[1886] : $â©ñôç[1887]; $íÛûÉ›Š[$â©ñôç[1820]] = $â©ñôç[12]; $íÛûÉ›Š[$â©ñôç[829]] = $Ù·Ô¤–˜; $íÛûÉ›Š[$â©ñôç[1883]] = $â©ñôç[389]; $this->update(); } public function unzipAfter($ö¡‘Õœ) { $ŒÍàÑÕñ =& $_SERVER[ÆªÈ–¬]; $Úü®”“ =& $this->task; $Úü®”“[$ŒÍàÑÕñ[1883]] = $ŒÍàÑÕñ[110]; $×Ûôï¢à = IO::infoWithChildren($ö¡‘Õœ); $Šæš·ã® = 0; $Úü®”“[$ŒÍàÑÕñ[1827]] = array($ŒÍàÑÕñ[1828] => $Šæš·ã® + 1, $ŒÍàÑÕñ[494] => $×Ûôï¢à[$ŒÍàÑÕñ[32]], $ŒÍàÑÕñ[87] => $×Ûôï¢à[$ŒÍàÑÕñ[87]], $ŒÍàÑÕñ[582] => $×Ûôï¢à[$ŒÍàÑÕñ[582]] ? $×Ûôï¢à[$ŒÍàÑÕñ[582]] : $×Ûôï¢à[$ŒÍàÑÕñ[87]]); if ($×Ûôï¢à[$ŒÍàÑÕñ[33]] == $ŒÍàÑÕñ[230]) { $Úü®”“[$ŒÍàÑÕñ[1134]] = 1; } else { $Úü®”“[$ŒÍàÑÕñ[1134]] = $×Ûôï¢à[$ŒÍàÑÕñ[82]][$ŒÍàÑÕñ[80]]; } $Úü®”“[$ŒÍàÑÕñ[1136]] = $ŒÍàÑÕñ[12]; $Úü®”“[$ŒÍàÑÕñ[1820]] = 0; $Úü®”“[$ŒÍàÑÕñ[1766]] = 0; $Úü®”“[$ŒÍàÑÕñ[1818]] = 0; $Úü®”“[$ŒÍàÑÕñ[1819]] = 0; $Úü®”“[$ŒÍàÑÕñ[1816]] = $ŒÍàÑÕñ[12]; $Úü®”“[$ŒÍàÑÕñ[1823]] = 0; $Úü®”“[$ŒÍàÑÕñ[829]] = $×Ûôï¢à[$ŒÍàÑÕñ[79]]; $this->update(); self::log($ŒÍàÑÕñ[1888] . json_encode(array($Úü®”“, $×Ûôï¢à))); } public function nameParse($Õ†çï®€) { $Ô³æğºü =& $_SERVER[ÆªÈ–¬]; $Ï‰ú„ĞÅ =& $this->task; if ($Ï‰ú„ĞÅ[$Ô³æğºü[1883]] == $Ô³æğºü[1272]) { $Ï‰ú„ĞÅ[$Ô³æğºü[1883]] = $Ô³æğºü[389]; $Ï‰ú„ĞÅ[$Ô³æğºü[1823]] = 0; $Ï‰ú„ĞÅ[$Ô³æğºü[829]] = 0; } $¸°Ÿ±“ = get_path_this($Õ†çï®€); if (strstr($¸°Ÿ±“, $Ô³æğºü[10])) { $Ï‰ú„ĞÅ[$Ô³æğºü[1766]] += 1; $Ï‰ú„ĞÅ[$Ô³æğºü[1134]] += 1; } $Ï‰ú„ĞÅ[$Ô³æğºü[1816]] = $Õ†çï®€; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¸œ„¯òû =& $_SERVER[ÆªÈ–¬]; parent::startAfter(); Hook::bind($¸œ„¯òû[1889], array($this, $¸œ„¯òû[1879])); Hook::bind($¸œ„¯òû[1881], array($this, $¸œ„¯òû[1882])); $›ùö®•ş =& $this->task; $›ùö®•ş[$¸œ„¯òû[1883]] = $¸œ„¯òû[1272]; if (!$›ùö®•ş[$¸œ„¯òû[1651]]) { $›ùö®•ş[$¸œ„¯òû[1651]] = LNG($¸œ„¯òû[1890]); } } protected function endAfter() { $Òş¨À—Ô =& $_SERVER[ÆªÈ–¬]; parent::endAfter(); Hook::unbind($Òş¨À—Ô[1889], array($this, $Òş¨À—Ô[1879])); Hook::unbind($Òş¨À—Ô[1881], array($this, $Òş¨À—Ô[1882])); } public function updateAfter() { $çÃæ¸‰Æ =& $_SERVER[ÆªÈ–¬]; $‹ÓŠáƒ =& $this->task; if (!$‹ÓŠáƒ[$çÃæ¸‰Æ[1134]] || !$‹ÓŠáƒ[$çÃæ¸‰Æ[829]]) { return; } if ($‹ÓŠáƒ[$çÃæ¸‰Æ[1883]] == $çÃæ¸‰Æ[1272]) { $±Ãò¶ Û = $‹ÓŠáƒ[$çÃæ¸‰Æ[1819]]; if ($‹ÓŠáƒ[$çÃæ¸‰Æ[1820]] != $çÃæ¸‰Æ[1272]) { $±Ãò¶ Û = 0; } $ÓŒ„û¬ = ($‹ÓŠáƒ[$çÃæ¸‰Æ[1823]] + $±Ãò¶ Û) / $‹ÓŠáƒ[$çÃæ¸‰Æ[829]]; $‹ÓŠáƒ[$çÃæ¸‰Æ[1767]] = $ÓŒ„û¬ * 0.3; } else { if ($‹ÓŠáƒ[$çÃæ¸‰Æ[1883]] == $çÃæ¸‰Æ[389]) { $ÓŒ„û¬ = $‹ÓŠáƒ[$çÃæ¸‰Æ[1766]] / $‹ÓŠáƒ[$çÃæ¸‰Æ[1134]]; $‹ÓŠáƒ[$çÃæ¸‰Æ[1767]] = 0.3 + $ÓŒ„û¬ * 0.5; } else { if ($‹ÓŠáƒ[$çÃæ¸‰Æ[1883]] == $çÃæ¸‰Æ[110]) { $ÓŒ„û¬ = 0; if ($‹ÓŠáƒ[$çÃæ¸‰Æ[1818]]) { $ÓŒ„û¬ = $‹ÓŠáƒ[$çÃæ¸‰Æ[1819]] / $‹ÓŠáƒ[$çÃæ¸‰Æ[1818]]; } $‹ÓŠáƒ[$çÃæ¸‰Æ[1767]] = 0.3 + 0.5 + $ÓŒ„û¬ * 0.2; } } } if ($‹ÓŠáƒ[$çÃæ¸‰Æ[1767]] > 0) { $ì¢İ¯™ = timeFloat() - $‹ÓŠáƒ[$çÃæ¸‰Æ[1769]] - $‹ÓŠáƒ[$çÃæ¸‰Æ[1772]]; $‹ÓŠáƒ[$çÃæ¸‰Æ[1773]] = $ì¢İ¯™ * (1 - $‹ÓŠáƒ[$çÃæ¸‰Æ[1767]]) / $‹ÓŠáƒ[$çÃæ¸‰Æ[1767]]; } } public function copyFileStart($ğ‰ä“œ, $á½À²ÌÔ, $€Œ¼§ö‚, $©‘ø¿ß·, $¶õÄ–İ, $×”Ô£Ô) { $Ë±´£ƒ“ =& $_SERVER[ÆªÈ–¬]; parent::copyFileStart($ğ‰ä“œ, $á½À²ÌÔ, $€Œ¼§ö‚, $©‘ø¿ß·, $¶õÄ–İ, $×”Ô£Ô); $¹Ïò‚ =& $this->task; if ($¹Ïò‚[$Ë±´£ƒ“[1883]] == $Ë±´£ƒ“[389]) { $¹Ïò‚[$Ë±´£ƒ“[1883]] = $Ë±´£ƒ“[110]; } $this->update(); } public function copyFileEnd($ã¥ú¿±½, $ó—Æ¾Í¶, $ñ ²ÃÊ›, $ÂéÂÈŸ, $äÖáµœü, $Î¤÷ùûË) { $É†ô†º =& $_SERVER[ÆªÈ–¬]; $é¿Èû¨ =& $this->task; $é¿Èû¨[$É†ô†º[1819]] = $é¿Èû¨[$É†ô†º[1818]]; $é¿Èû¨[$É†ô†º[1823]] += $é¿Èû¨[$É†ô†º[1818]]; $é¿Èû¨[$É†ô†º[1820]] = $É†ô†º[12]; $this->update(); } public function zipEvent($ƒ³ÅÛ¦Õ, $§åä»Úë, $«¼úÃŞ, $Ğ—†«Í) { $Í‹çÑˆ­ =& $_SERVER[ÆªÈ–¬]; $Ø¸‘†Â˜ =& $this->task; $Ø¸‘†Â˜[$Í‹çÑˆ­[1816]] = get_path_this($§åä»Úë); $Ø¸‘†Â˜[$Í‹çÑˆ­[1818]] = $Ğ—†«Í; $Ø¸‘†Â˜[$Í‹çÑˆ­[1819]] = $«¼úÃŞ; $Ø¸‘†Â˜[$Í‹çÑˆ­[1136]] = $ƒ³ÅÛ¦Õ == $Í‹çÑˆ­[1891] ? $Í‹çÑˆ­[1886] : $Í‹çÑˆ­[1887]; $Ø¸‘†Â˜[$Í‹çÑˆ­[1820]] = $Í‹çÑˆ­[12]; $Ø¸‘†Â˜[$Í‹çÑˆ­[829]] = $Ğ—†«Í; $Ø¸‘†Â˜[$Í‹çÑˆ­[1883]] = $Í‹çÑˆ­[389]; $this->update(); } public function nameParse($½ÈÊå±) { $‹©»Õ‹ó =& $_SERVER[ÆªÈ–¬]; $šåâ¿Ş™ =& $this->task; if ($šåâ¿Ş™[$‹©»Õ‹ó[1766]] < $šåâ¿Ş™[$‹©»Õ‹ó[1134]]) { $Â×š‰ç÷ = get_path_this($½ÈÊå±); if (strstr($Â×š‰ç÷, $‹©»Õ‹ó[10])) { $šåâ¿Ş™[$‹©»Õ‹ó[1766]] += 1; } } if ($šåâ¿Ş™[$‹©»Õ‹ó[1883]] == $‹©»Õ‹ó[1272]) { $šåâ¿Ş™[$‹©»Õ‹ó[1883]] = $‹©»Õ‹ó[389]; } $šåâ¿Ş™[$‹©»Õ‹ó[1816]] = $½ÈÊå±; $this->update(); } } goto DĞß´×‡°Ş; EÒ®ªŸëÒË: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\x65\156\164"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\x61\155\145" => "\x63\157\x6d\155\145\156\x74\137\x6d\x65\x74\141", "\x6d\x65\164\x61\x46\x69\145\154\144" => "\x63\x6f\x6d\155\x65\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÎÌ—ê ğ) { $†óıÌç =& $_SERVER[ÆªÈ–¬]; if ($ÎÌ—ê ğ[$†óıÌç[1993]]) { $˜û“ô¯¾ = $this->where(array($†óıÌç[1994] => $ÎÌ—ê ğ[$†óıÌç[1993]]))->find(); if (!$˜û“ô¯¾ || $˜û“ô¯¾[$†óıÌç[190]] != $ÎÌ—ê ğ[$†óıÌç[190]] || $˜û“ô¯¾[$†óıÌç[569]] != $ÎÌ—ê ğ[$†óıÌç[569]]) { return !1; } $this->where(array($†óıÌç[1994] => $ÎÌ—ê ğ[$†óıÌç[1993]]))->setAdd($†óıÌç[1995], 1); } $ÎÌ—ê ğ[$†óıÌç[1996]] = 0; $ÎÌ—ê ğ[$†óıÌç[1995]] = 0; $ÎÌ—ê ğ[$†óıÌç[816]] = 1; return $this->add($ÎÌ—ê ğ); } public function commentCount($ŸëÊŠÒ¿, $ÈÌèŠ­Ô, $ñ¬Œó¤ = false) { $‡ùªäúÀ =& $_SERVER[ÆªÈ–¬]; if (!$ŸëÊŠÒ¿) { return array(); } if (is_string($ŸëÊŠÒ¿) || is_int($ŸëÊŠÒ¿)) { $ŸëÊŠÒ¿ = array($ŸëÊŠÒ¿); } $Îº”‘…÷ = array($‡ùªäúÀ[569], $‡ùªäúÀ[1997] => $‡ùªäúÀ[565]); $³—¡¡À = array($‡ùªäúÀ[569] => array($‡ùªäúÀ[7], $ŸëÊŠÒ¿), $‡ùªäúÀ[190] => $ÈÌèŠ­Ô); if ($ñ¬Œó¤) { $³—¡¡À[$‡ùªäúÀ[1765]] = $ñ¬Œó¤; } $²ƒ…‹Úø = $this->field($Îº”‘…÷)->where($³—¡¡À)->group($‡ùªäúÀ[569])->select(); return array_to_keyvalue($²ƒ…‹Úø, $‡ùªäúÀ[569], $‡ùªäúÀ[565]); } public function starTarget($÷¤ÎØÚ­, $Í“×‰È²) { $À‘ôÃ¥õ =& $_SERVER[ÆªÈ–¬]; $Ì Å·Ûò = $÷¤ÎØÚ­ + self::TYPE_STAR_OFFSET; $•ñîğ©‘ = array($À‘ôÃ¥õ[1765] => USER_ID, $À‘ôÃ¥õ[190] => $Ì Å·Ûò, $À‘ôÃ¥õ[569] => $Í“×‰È²); $€›ÀŸú€ = $this->where($•ñîğ©‘)->find(); if ($€›ÀŸú€) { return $this->where(array($À‘ôÃ¥õ[475] => $€›ÀŸú€[$À‘ôÃ¥õ[475]]))->delete(); } $£˜‰ö¢º = array($À‘ôÃ¥õ[1993] => 0, $À‘ôÃ¥õ[1765] => USER_ID, $À‘ôÃ¥õ[816] => 1, $À‘ôÃ¥õ[171] => $À‘ôÃ¥õ[12], $À‘ôÃ¥õ[190] => $Ì Å·Ûò, $À‘ôÃ¥õ[569] => $Í“×‰È², $À‘ôÃ¥õ[1996] => 0, $À‘ôÃ¥õ[1995] => 0); return $this->add($£˜‰ö¢º); } public function starTargetCount($ÛÅØë›­, $É¾œü») { $Ù”„Ş¹æ =& $_SERVER[ÆªÈ–¬]; $Àâ«ºÎÈ = $É¾œü» + self::TYPE_STAR_OFFSET; $œõæšº¾ = $this->commentCount($ÛÅØë›­, $Àâ«ºÎÈ); $’Œà¡¿Ä = $this->commentCount($ÛÅØë›­, $Àâ«ºÎÈ, USER_ID); return array($Ù”„Ş¹æ[1998] => $œõæšº¾, $Ù”„Ş¹æ[1999] => $’Œà¡¿Ä); } public function starTargetUserList($½»Íõ³ı, $Šª­Šï) { $À§ƒ—Î± =& $_SERVER[ÆªÈ–¬]; $€¢— ˜ú = $½»Íõ³ı + self::TYPE_STAR_OFFSET; $¾ÉŸ‘âˆ = array($À§ƒ—Î±[569] => $Šª­Šï, $À§ƒ—Î±[190] => $€¢— ˜ú); $‘Ãöüæ± = $this->where($¾ÉŸ‘âˆ)->count(); $Š’‘½›é = array($À§ƒ—Î±[332] => $‘Ãöüæ±, $À§ƒ—Î±[2000] => array()); if (!$‘Ãöüæ±) { return $Š’‘½›é; } $¢™­Àå = $this->field($À§ƒ—Î±[1765])->where($¾ÉŸ‘âˆ)->limit(500)->select(); $¢™­Àå = array_to_keyvalue($¢™­Àå, $À§ƒ—Î±[12], $À§ƒ—Î±[1765]); $Š’‘½›é[$À§ƒ—Î±[2000]] = Model($À§ƒ—Î±[577])->userListInfo($¢™­Àå); return $Š’‘½›é; } public function prasiseUserList($Ï˜Æã”À) { $¸ë¥ñ² =& $_SERVER[ÆªÈ–¬]; $™ÛÒ¥Ü× = array($¸ë¥ñ²[2001] => $Ï˜Æã”À); $Âı–¶şõ = $this->where($™ÛÒ¥Ü×)->find(); $ü€ï´£ = _get($Âı–¶şõ, $¸ë¥ñ²[1996], 0); $‰û×åæü = array($¸ë¥ñ²[332] => $ü€ï´£, $¸ë¥ñ²[2000] => array()); if (!$ü€ï´£) { return $‰û×åæü; } $„´·âæ¼ = Model($¸ë¥ñ²[2002])->field($¸ë¥ñ²[1765])->where($™ÛÒ¥Ü×)->limit(500)->select(); $„´·âæ¼ = array_to_keyvalue($„´·âæ¼, $¸ë¥ñ²[12], $¸ë¥ñ²[1765]); $‰û×åæü[$¸ë¥ñ²[2000]] = Model($¸ë¥ñ²[577])->userListInfo($„´·âæ¼); return $‰û×åæü; } public function remove($Ê‡—¸îÕ) { $Ü“ƒÀßÜ =& $_SERVER[ÆªÈ–¬]; $÷ã˜ëÑƒ = array($Ü“ƒÀßÜ[1994] => $Ê‡—¸îÕ); $–Ü˜äà = $this->where($÷ã˜ëÑƒ)->find(); if ($–Ü˜äà[$Ü“ƒÀßÜ[1993]]) { $this->where(array($Ü“ƒÀßÜ[1994] => $–Ü˜äà[$Ü“ƒÀßÜ[1993]]))->setAdd($Ü“ƒÀßÜ[1995], -1); } return $this->where($÷ã˜ëÑƒ)->delete(); } public function edit($ø™ËÍ, $Â³«§Ò) { $Ùì¾¼ÉÁ =& $_SERVER[ÆªÈ–¬]; $©Ò´¡Áı = array($Ùì¾¼ÉÁ[1994] => $ø™ËÍ); return $this->where($©Ò´¡Áı)->save(array($Ùì¾¼ÉÁ[2003] => $Â³«§Ò)); } public function prasise($¯æ¡İú×) { $«˜…»®Æ =& $_SERVER[ÆªÈ–¬]; $È¡ğ® = Model($«˜…»®Æ[2004]); $á×û·©ß = array($«˜…»®Æ[1994] => $¯æ¡İú×, $«˜…»®Æ[1756] => USER_ID); $„ºçÉ‰À = $È¡ğ®->where($á×û·©ß)->find(); if (!$„ºçÉ‰À) { $È¡ğ®->add($á×û·©ß); $Î›½ˆ = $this->where(array($«˜…»®Æ[1994] => $¯æ¡İú×))->setAdd($«˜…»®Æ[1996], 1); } else { $È¡ğ®->where($á×û·©ß)->delete(); $Î›½ˆ = $this->where(array($«˜…»®Æ[1994] => $¯æ¡İú×))->setAdd($«˜…»®Æ[1996], -1); } return $Î›½ˆ; } public function targetInfo($Š­ØÜ, $Æ°ºµ¬”) { $ÑùÌÄê =& $_SERVER[ÆªÈ–¬]; $à²İøµ¾ = array($ÑùÌÄê[648] => $Š­ØÜ, $ÑùÌÄê[649] => $Æ°ºµ¬”); $êŠ²û„Ì = $this->where($à²İøµ¾)->count(); $ãÜçÔõÌ = "\122\x49\107\x48\x54\x20\112\117\111\x4e\40{$this->tablePrefix}\x63\157\155\x6d\x65\x6e\x74\137\x70\162\141\151\163\x65\40\x73\x74\141\x72\x20\x6f\156\x20\143\157\x6d\x6d\145\156\x74\x2e\x63\x6f\155\x6d\x65\x6e\164\111\x44\40\x3d\40\163\164\x61\x72\x2e\143\x6f\155\x6d\145\x6e\x74\111\104"; $†¤‚û™³ = $this->alias($ÑùÌÄê[430])->where($à²İøµ¾)->join($ãÜçÔõÌ, $ÑùÌÄê[2005])->count(); $ĞÖù•ËÎ = array($ÑùÌÄê[2006] => $êŠ²û„Ì, $ÑùÌÄê[2007] => $†¤‚û™³); return $ĞÖù•ËÎ; } public function listData($‡ÇÊ«ğ…) { $ƒ¸Ÿ·Ëô =& $_SERVER[ÆªÈ–¬]; if (isset($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2008]])) { if ($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2008]]) { $‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2001]] = array($ƒ¸Ÿ·Ëô[1085], intval($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2008]])); } unset($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2008]]); } if (isset($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2009]])) { if ($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2009]]) { $‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2001]] = array($ƒ¸Ÿ·Ëô[1082], intval($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2009]])); } unset($‡ÇÊ«ğ…[$ƒ¸Ÿ·Ëô[2009]]); } return $this->_listData($‡ÇÊ«ğ…); } private function _listData($ã–­É¯£) { $ìÕ„ÖµÎ =& $_SERVER[ÆªÈ–¬]; $µô¨‚àé = $this->where($ã–­É¯£)->_makeOrder()->selectPage(100); $this->_listAppendParent($µô¨‚àé[$ìÕ„ÖµÎ[445]]); $this->_listAppendUser($µô¨‚àé[$ìÕ„ÖµÎ[445]]); $this->_listAppendMeta($µô¨‚àé[$ìÕ„ÖµÎ[445]]); return $µô¨‚àé; } private function _makeOrder() { $¤¢¤…®â =& $_SERVER[ÆªÈ–¬]; $ìîÔ§¦ = array($¤¢¤…®â[1996], $¤¢¤…®â[1995], $¤¢¤…®â[231]); $…øÑ¯Ù = Input::get($¤¢¤…®â[530], $¤¢¤…®â[7], $¤¢¤…®â[497], $ìîÔ§¦); $¬Õ…æÄ = Input::get($¤¢¤…®â[531], $¤¢¤…®â[7], $¤¢¤…®â[1758], array($¤¢¤…®â[2010], $¤¢¤…®â[526])); $Æ•çÆ„ = $…øÑ¯Ù . $¤¢¤…®â[53] . $¬Õ…æÄ; return $this->order($Æ•çÆ„); } private function _listAppendParent(&$üãÉŠ°Õ) { $åÕ²‚Ğ¡ =& $_SERVER[ÆªÈ–¬]; $»ñøå°“ = array_unique(array_to_keyvalue($üãÉŠ°Õ, $åÕ²‚Ğ¡[12], $åÕ²‚Ğ¡[1993])); $»ñøå°“ = array_remove_value($»ñøå°“, $åÕ²‚Ğ¡[228]); if (!$»ñøå°“) { return; } $âç‘›êæ = $this->where(array($åÕ²‚Ğ¡[1994] => array($åÕ²‚Ğ¡[7], $»ñøå°“)))->select(); $âç‘›êæ = array_to_keyvalue($âç‘›êæ, $åÕ²‚Ğ¡[2001]); foreach ($üãÉŠ°Õ as &$û¯´Ë) { if (isset($âç‘›êæ[$û¯´Ë[$åÕ²‚Ğ¡[1993]]])) { $û¯´Ë[$åÕ²‚Ğ¡[2011]] = $âç‘›êæ[$û¯´Ë[$åÕ²‚Ğ¡[1993]]]; } } unset($û¯´Ë); } private function _listAppendUser(&$çøóÎá) { $ææÑ¸‘ =& $_SERVER[ÆªÈ–¬]; $ª ›ÅûÖ = array_unique(array_to_keyvalue($çøóÎá, $ææÑ¸‘[12], $ææÑ¸‘[1765])); $ª ›ÅûÖ = array_remove_value($ª ›ÅûÖ, $ææÑ¸‘[228]); if (count($ª ›ÅûÖ) == 0) { return; } foreach ($çøóÎá as $¦ä¶±±) { if (isset($¦ä¶±±[$ææÑ¸‘[2011]])) { $ª ›ÅûÖ[] = $¦ä¶±±[$ææÑ¸‘[2011]][$ææÑ¸‘[1765]]; } } $ÏïŸ‚ = Model($ææÑ¸‘[598])->userListInfo($ª ›ÅûÖ); foreach ($çøóÎá as &$¦ä¶±±) { $¦ä¶±±[$ææÑ¸‘[662]] = $ÏïŸ‚[$¦ä¶±±[$ææÑ¸‘[1765]]]; if (isset($¦ä¶±±[$ææÑ¸‘[2011]])) { $¦ä¶±±[$ææÑ¸‘[2011]][$ææÑ¸‘[662]] = $ÏïŸ‚[$¦ä¶±±[$ææÑ¸‘[2011]][$ææÑ¸‘[1765]]]; } } unset($¦ä¶±±); } private function _listAppendMeta(&$£Ç‘½õ›) { $Èë®¬£ =& $_SERVER[ÆªÈ–¬]; $åúù‚ì = array_unique(array_to_keyvalue($£Ç‘½õ›, $Èë®¬£[12], $Èë®¬£[2001])); $åúù‚ì = array_remove_value($åúù‚ì, $Èë®¬£[228]); if (!$åúù‚ì) { return; } foreach ($£Ç‘½õ› as $ä¼²ÆÚ) { if (isset($ä¼²ÆÚ[$Èë®¬£[2011]])) { $åúù‚ì[] = $ä¼²ÆÚ[$Èë®¬£[2011]][$Èë®¬£[2001]]; } } $Íé ˆŞ° = $this->metaList($åúù‚ì); if (!$Íé ˆŞ°) { return !1; } foreach ($£Ç‘½õ› as &$ä¼²ÆÚ) { $ä¼²ÆÚ[$Èë®¬£[539]] = $Íé ˆŞ°[$ä¼²ÆÚ[$Èë®¬£[2001]]]; if (isset($ä¼²ÆÚ[$Èë®¬£[2011]])) { $ä¼²ÆÚ[$Èë®¬£[2011]][$Èë®¬£[539]] = $Íé ˆŞ°[$ä¼²ÆÚ[$Èë®¬£[2011]][$Èë®¬£[2001]]]; } } unset($ä¼²ÆÚ); } private function metaList($ºÏé€¯Ã) { $Ã¹ÓÛ°ñ =& $_SERVER[ÆªÈ–¬]; if (!$ºÏé€¯Ã) { return array(); } $ôÀÂ¢¾® = array($Ã¹ÓÛ°ñ[2001] => array($Ã¹ÓÛ°ñ[7], $ºÏé€¯Ã)); $‹êâ ¾¾ = Model($Ã¹ÓÛ°ñ[2012])->where($ôÀÂ¢¾®)->select(); $‹êâ ¾¾ = array_to_keyvalue_group($‹êâ ¾¾, $Ã¹ÓÛ°ñ[2001]); foreach ($‹êâ ¾¾ as $İé¬Ì“ => $ª×Çíî) { $²÷ßıÆª = array(); foreach ($ª×Çíî as $—ùí˜Ğù) { $²÷ßıÆª[$—ùí˜Ğù[$Ã¹ÓÛ°ñ[97]]] = $—ùí˜Ğù[$Ã¹ÓÛ°ñ[450]]; } $‹êâ ¾¾[$İé¬Ì“] = $²÷ßıÆª; } return $‹êâ ¾¾ ? $‹êâ ¾¾ : array(); } public function removeTarget($¶±Ø”¡š, $¶›ƒº²²) { $–øØÑ¸Ñ =& $_SERVER[ÆªÈ–¬]; if (!$¶›ƒº²²) { return !0; } $¶›ƒº²² = is_array($¶›ƒº²²) ? $¶›ƒº²² : array($¶›ƒº²²); $®­º‚ = array($–øØÑ¸Ñ[190] => $¶±Ø”¡š, $–øØÑ¸Ñ[569] => array($–øØÑ¸Ñ[7], $¶›ƒº²²)); $Å „‹Â˜ = $this->field($–øØÑ¸Ñ[2001])->where($®­º‚)->select(); $ÊĞä®ñ = array_to_keyvalue($Å „‹Â˜, $–øØÑ¸Ñ[12], $–øØÑ¸Ñ[2001]); if (!$ÊĞä®ñ) { return !0; } $®­º‚ = array($–øØÑ¸Ñ[2001] => array($–øØÑ¸Ñ[7], $ÊĞä®ñ)); $this->where($®­º‚)->delete(); Model($–øØÑ¸Ñ[2004])->where($®­º‚)->delete(); Model($–øØÑ¸Ñ[2013])->where($®­º‚)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145\137\x63\157\x6e\164\145\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\x54\x69\x6d\x65", "\164\151\155\145", "\x69\x6e\163\145\x72\164", "\146\x75\x6e\143\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\x6c\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\x61\155\x65" => "\151\x6f\137\146\x69\x6c\x65\x5f\x6d\x65\x74\141", "\155\x65\164\141\106\x69\145\x6c\x64" => "\146\x69\154\x65\x49\104"); public function fileInfo($ä‡§ ¹Ï) { $¡¹Ö©À· =& $_SERVER[ÆªÈ–¬]; static $­Ôğ®Ô = array(); if (!isset($­Ôğ®Ô[$ä‡§ ¹Ï])) { $ß€¿ß®° = $¡¹Ö©À·[2014]; $”İøîÆ  = Model($¡¹Ö©À·[544])->field($ß€¿ß®°)->where(array($¡¹Ö©À·[542] => $ä‡§ ¹Ï))->find(); $­Ôğ®Ô[$ä‡§ ¹Ï] = $”İøîÆ ; } return $­Ôğ®Ô[$ä‡§ ¹Ï]; } public function addFileByContent($•ÀæÙ¨º = '', $–ş«±‚ç = '') { $üïí²»« =& $_SERVER[ÆªÈ–¬]; $¾Î…²¡§ = TEMP_PATH . $üïí²»«[2015]; if (!is_dir($¾Î…²¡§)) { mk_dir($¾Î…²¡§); } $ƒ‚âÚ = $¾Î…²¡§ . $üïí²»«[2016] . rand_string(16); file_put_contents($ƒ‚âÚ, $•ÀæÙ¨º); $ıö³‹ë = $this->addFile($ƒ‚âÚ, $–ş«±‚ç, !0); if (file_exists($ƒ‚âÚ)) { @unlink($ƒ‚âÚ); } return $ıö³‹ë; } public function createFileName($¿õ¦åÁ, $ÌõÏÉû = false, $¡è§°å¬ = false) { $òº¹¸©© =& $_SERVER[ÆªÈ–¬]; $€âÃÈäã = IO::init($òº¹¸©©[8]); $ñÔ•†öë = $this->makeFilePath($¿õ¦åÁ, $€âÃÈäã, $ÌõÏÉû, $¡è§°å¬); $•š¬íí‰ = $€âÃÈäã->pathFather($ñÔ•†öë); static $Èäêëµ‘ = false; $˜·®çöæ = $òº¹¸©©[2017] . md5($•š¬íí‰); if (!$Èäêëµ‘ && !Cache::get($˜·®çöæ)) { $Èäêëµ‘ = !0; $®Õ÷Ÿ¸Ö = IO::mkdir($•š¬íí‰); if (!IO::exist($®Õ÷Ÿ¸Ö . $òº¹¸©©[863])) { IO::mkfile($®Õ÷Ÿ¸Ö . $òº¹¸©©[863]); } Cache::set($˜·®çöæ, 1, 3600 * 2); } return $ñÔ•†öë; } public function makeFilePath($¤«‚¹ø, $’÷”Ô×Ó, $°Ôï´–‘ = false, $û´™ì§Ë = false) { $Ïíİæó =& $_SERVER[ÆªÈ–¬]; $êò×ƒû¯ = Model($Ïíİæó[836])->get($Ïíİæó[2018]); $ıßÓÒµ = KodIO::defaultIO() . date($Ïíİæó[2019]); $¤˜—ùø¯ = $ıßÓÒµ . rand_string(5) . short_id(100); $¤«‚¹ø = str_replace($Ïíİæó[8], $Ïíİæó[11], KodIO::clear($¤«‚¹ø)); $îã¥ğ¬à = $’÷”Ô×Ó->ext($¤«‚¹ø); if (!$¤«‚¹ø) { $êò×ƒû¯ = $Ïíİæó[842]; } switch ($êò×ƒû¯) { case $Ïíİæó[2020]: if ($îã¥ğ¬à) { $¤˜—ùø¯ = $¤˜—ùø¯ . $Ïíİæó[10] . $îã¥ğ¬à; } if ($îã¥ğ¬à == $Ïíİæó[1956]) { $¤˜—ùø¯ .= $Ïíİæó[1284]; } break; case $Ïíİæó[2021]: $¤úÆÈ‰ñ = Model($Ïíİæó[836])->get($Ïíİæó[837]); $ñ–Ôˆµü = substr(md5($Ïíİæó[838] . $¤úÆÈ‰ñ . date($Ïíİæó[815])), 0, 8); $Ç´¼½Â¹ = KodIO::defaultDriver(); $ıßÓÒµ = $Ïíİæó[1315] . $Ç´¼½Â¹[$Ïíİæó[475]] . $Ïíİæó[484] . date($Ïíİæó[2022]) . $ñ–Ôˆµü . $Ïíİæó[8]; if ($îã¥ğ¬à == $Ïíİæó[1956]) { $¤«‚¹ø .= $Ïíİæó[1284]; } $Ëë¢•«» = $Ïíİæó[2023] . $ıßÓÒµ . $¤«‚¹ø; CacheLock::lock($Ëë¢•«»); $¤˜—ùø¯ = $ıßÓÒµ . $¤«‚¹ø; if (IO::exist($ıßÓÒµ . $¤«‚¹ø)) { $÷İ‰ôşŞ = substr($¤«‚¹ø, 0, strlen($¤«‚¹ø) - strlen($îã¥ğ¬à)); $ß¡úÌƒ = $û´™ì§Ë ? substr($û´™ì§Ë, 0, 5) : ($°Ôï´–‘ ? substr($°Ôï´–‘, 0, 5) : rand_string(5)); $¤˜—ùø¯ = $ıßÓÒµ . $÷İ‰ôşŞ . $ß¡úÌƒ; if ($îã¥ğ¬à) { $¤˜—ùø¯ = $¤˜—ùø¯ . $Ïíİæó[10] . $îã¥ğ¬à; } } if (IO::isOsDriver($¤˜—ùø¯) && !IO::isUploadServer($¤˜—ùø¯)) { if (IO::exist($¤˜—ùø¯)) { return $¤˜—ùø¯; } $êïç¹½ = IO::setContent($¤˜—ùø¯, $Ïíİæó[12]); if (!$êïç¹½) { show_json($Ïíİæó[2024], !1); } } CacheLock::unlock($Ëë¢•«»); break; case $Ïíİæó[842]: break; default: break; } return $¤˜—ùø¯; } public function addFileByRemote($ëÊ…ÔêŸ, $şåœ¡Êï, $Ëç–ğƒç = array()) { $¨§ˆº¥ =& $_SERVER[ÆªÈ–¬]; if (!IO::exist($ëÊ…ÔêŸ)) { return !1; } $•§Ñµˆâ = $Ëç–ğƒç[$¨§ˆº¥[547]] ? $Ëç–ğƒç[$¨§ˆº¥[547]] : $¨§ˆº¥[12]; $í¯é–‰˜ = IO::hashMd5($ëÊ…ÔêŸ, $•§Ñµˆâ); $õïñÒ¹À = KodIO::defaultDriver(); $ÌÁ½È¢· = array($¨§ˆº¥[617] => IO::size($ëÊ…ÔêŸ), $¨§ˆº¥[2025] => 1, $¨§ˆº¥[494] => $şåœ¡Êï, $¨§ˆº¥[874] => $õïñÒ¹À[$¨§ˆº¥[475]], $¨§ˆº¥[495] => $ëÊ…ÔêŸ, $¨§ˆº¥[2026] => $Ëç–ğƒç[$¨§ˆº¥[672]] ? $Ëç–ğƒç[$¨§ˆº¥[672]] : IO::hashSimple($ëÊ…ÔêŸ), $¨§ˆº¥[2027] => $í¯é–‰˜ ? $í¯é–‰˜ : $•§Ñµˆâ); if ($ô™¸ñé = $this->addFileCheckExist($ÌÁ½È¢·[$¨§ˆº¥[672]], $ÌÁ½È¢·[$¨§ˆº¥[547]], $ÌÁ½È¢·[$¨§ˆº¥[79]])) { return $ô™¸ñé; } return $this->addFileData($ÌÁ½È¢·); } private function addFileData($ÌËàÆëÃ) { $§“ªù¶Ô =& $_SERVER[ÆªÈ–¬]; if (!$ÌËàÆëÃ) { return !1; } $ÌËàÆëÃ[$§“ªù¶Ô[79]] = intval($ÌËàÆëÃ[$§“ªù¶Ô[79]]); if (!$ÌËàÆëÃ[$§“ªù¶Ô[79]] && strlen($ÌËàÆëÃ[$§“ªù¶Ô[672]]) > 32) { $ÌËàÆëÃ[$§“ªù¶Ô[79]] = intval(substr($ÌËàÆëÃ[$§“ªù¶Ô[672]], 32)); } $é…ÎØùœ = $this->add($ÌËàÆëÃ); return $this->find($é…ÎØùœ); } public function addFile($ü¾œ¹‚Ì, $¶³œ­¼, $Ô‚Ğıíå = false) { $­² Àˆ– =& $_SERVER[ÆªÈ–¬]; $öµù¨¾Õ = IO::hashSimple($ü¾œ¹‚Ì); $ƒ¼ßİ¹€ = IO::size($ü¾œ¹‚Ì); $íİ¼Ş¡ü = $ƒ¼ßİ¹€ <= 1024 * 1024 * 10 ? IO::hashMd5($ü¾œ¹‚Ì) : $­² Àˆ–[12]; $Ëê·ÄÍ = $­² Àˆ–[2028] . $öµù¨¾Õ; CacheLock::lock($Ëê·ÄÍ); if ($íİ¼Ş¡ü && $öµù¨¾Õ) { $·—à©¡ = $this->addFileCheckExist($öµù¨¾Õ, $íİ¼Ş¡ü, $ƒ¼ßİ¹€); if ($·—à©¡) { CacheLock::unlock($Ëê·ÄÍ); return $·—à©¡; } } $½ş©™æù = $this->addFileMake($ü¾œ¹‚Ì, $ƒ¼ßİ¹€, $öµù¨¾Õ, $íİ¼Ş¡ü, $¶³œ­¼, $Ô‚Ğıíå); $“ĞİÄ»½ = $this->addFileData($½ş©™æù); CacheLock::unlock($Ëê·ÄÍ); if (!$íİ¼Ş¡ü && $“ĞİÄ»½) { $this->fileMd5Check($“ĞİÄ»½); } return $“ĞİÄ»½; } public function fileMd5Check($ãÓîÁà) { $ÆÉôÏŒ =& $_SERVER[ÆªÈ–¬]; $åÇ»íæ¼ = array($ãÓîÁà[$ÆÉôÏŒ[541]], $ãÓîÁà[$ÆÉôÏŒ[87]]); $’£ª‘ø‘ = $ÆÉôÏŒ[2029] . $ãÓîÁà[$ÆÉôÏŒ[87]]; $Ï”ßĞÆç = $ÆÉôÏŒ[2030] . $ãÓîÁà[$ÆÉôÏŒ[541]]; TaskQueue::add($ÆÉôÏŒ[2031], $åÇ»íæ¼, $’£ª‘ø‘, $Ï”ßĞÆç); } public function fileMd5Set($âç×İ×Í, $öÓŠêÒ) { $ŒÀ£½­‰ =& $_SERVER[ÆªÈ–¬]; $ÛÎ¤äàø = $this->find($âç×İ×Í); if (!$ÛÎ¤äàø || $ÛÎ¤äàø[$ŒÀ£½­‰[547]]) { return; } $¤¿™™ÌÂ = IO::hashMd5($öÓŠêÒ); if (!$¤¿™™ÌÂ) { return $ŒÀ£½­‰[12]; } $this->where(array($ŒÀ£½­‰[541] => $âç×İ×Í))->save(array($ŒÀ£½­‰[547] => $¤¿™™ÌÂ)); } public function addFileMake($—»‘†‹Ü, $‘à±½¨¶, $öªÊ Ôé, $ëìÅœîâ, $¨—¤ñ¬, $©²¦±š) { $¨’¶˜À =& $_SERVER[ÆªÈ–¬]; $¹Ò˜†ÓÖ = $this->createFileName($¨—¤ñ¬, $öªÊ Ôé, $ëìÅœîâ); $Şù×«»Ø = get_path_father($¹Ò˜†ÓÖ); $•ô«”ñı = get_path_this($¹Ò˜†ÓÖ); if ($©²¦±š) { $â‚—çØ‚ = IO::move($—»‘†‹Ü, $Şù×«»Ø, !1, $•ô«”ñı); } else { $â‚—çØ‚ = IO::copy($—»‘†‹Ü, $Şù×«»Ø, !1, $•ô«”ñı); } if (!$â‚—çØ‚) { return !1; } $ƒ¥ìç”¯ = KodIO::defaultDriver(); $¥‚İ—ôÜ = array($¨’¶˜À[617] => $‘à±½¨¶, $¨’¶˜À[2025] => 1, $¨’¶˜À[494] => $¨—¤ñ¬, $¨’¶˜À[874] => $ƒ¥ìç”¯[$¨’¶˜À[475]], $¨’¶˜À[495] => $¹Ò˜†ÓÖ, $¨’¶˜À[2026] => $öªÊ Ôé, $¨’¶˜À[2027] => $ëìÅœîâ); return $¥‚İ—ôÜ; } public function addFileCheckExist($ğÌê³š½, $İÄÍ˜–, $õùşÍÂ) { $­ÃĞ´µ =& $_SERVER[ÆªÈ–¬]; $Ç¥ŠÓ¯ = $this->findByHash($ğÌê³š½, $İÄÍ˜–); if (!$Ç¥ŠÓ¯) { return !1; } $ô¥º§İı = array($­ÃĞ´µ[2025] => intval($Ç¥ŠÓ¯[$­ÃĞ´µ[2032]]) + 1, $­ÃĞ´µ[617] => $õùşÍÂ); $this->where(array($­ÃĞ´µ[542] => $Ç¥ŠÓ¯[$­ÃĞ´µ[541]]))->save($ô¥º§İı); return $Ç¥ŠÓ¯; } public function remove($§É¹¸ïì) { $this->linkCountChange($§É¹¸ïì, !1); $this->clearEmpty(); return !0; } public function linkAdd($½…å¡õâ) { $this->linkCountChange($½…å¡õâ, !0); } public function linkCountChange($˜Š—Ç¤, $Æ³Çã) { $àñâ«Î¬ =& $_SERVER[ÆªÈ–¬]; if (!$˜Š—Ç¤) { return; } if (!is_array($˜Š—Ç¤)) { $˜Š—Ç¤ = array($˜Š—Ç¤); } $ôœ¢«» = array(); foreach ($˜Š—Ç¤ as $Êº“úéÆ) { $ÎÆÅèÊ¥ = $Êº“úéÆ . $àñâ«Î¬[12]; if (!$ôœ¢«»[$ÎÆÅèÊ¥]) { $ôœ¢«»[$ÎÆÅèÊ¥] = 0; } $ôœ¢«»[$ÎÆÅèÊ¥]++; } $è“½¡µÀ = array(); foreach ($ôœ¢«» as $Êº“úéÆ => $Ê¤™ €) { $ÎÆÅèÊ¥ = $Ê¤™ € . $àñâ«Î¬[12]; if (!$è“½¡µÀ[$ÎÆÅèÊ¥]) { $è“½¡µÀ[$ÎÆÅèÊ¥] = array(); } $è“½¡µÀ[$ÎÆÅèÊ¥][] = $Êº“úéÆ; } foreach ($è“½¡µÀ as $Ê¤™ € => $¼²Ç¨ôø) { if (!$¼²Ç¨ôø) { continue; } $Ê¤™ € = $Æ³Çã ? $Ê¤™ € : -intval($Ê¤™ €); $¢°ÙÏ”Û = array($àñâ«Î¬[541] => array($àñâ«Î¬[7], $¼²Ç¨ôø)); if ($Ê¤™ € < 0) { $¢°ÙÏ”Û[$àñâ«Î¬[2032]] = array($àñâ«Î¬[1086], abs($Ê¤™ €)); } $this->where($¢°ÙÏ”Û)->setAdd($àñâ«Î¬[2032], $Ê¤™ €); } } public function findByHash($Ä¿åôÑÆ, $úÊı©ÃÊ = false) { $èÜûéÂ =& $_SERVER[ÆªÈ–¬]; if (!$Ä¿åôÑÆ && !$úÊı©ÃÊ) { return !1; } $úàúÛşœ = array($èÜûéÂ[2026] => $Ä¿åôÑÆ); if ($úÊı©ÃÊ) { $úàúÛşœ = array($èÜûéÂ[2027] => $úÊı©ÃÊ); } return $this->order($èÜûéÂ[2033])->where($úàúÛşœ)->find(); } public function clearEmpty($‚‡äİ¬Ë = 0) { $şØÁÀŠß =& $_SERVER[ÆªÈ–¬]; $£´üËŒ = time() - 3600 * 24 * $‚‡äİ¬Ë; $ß±äÑ«ß = $şØÁÀŠß[2034] . $£´üËŒ; $…£‚£í” = $this->where($ß±äÑ«ß)->select(); if (!$…£‚£í”) { return; } $è¿øº¨× = new Task($şØÁÀŠß[2035], $şØÁÀŠß[12], count($…£‚£í”)); foreach ($…£‚£í” as $¿ëêöÕ¤) { $è¿øº¨×->update(1); $this->resetFile($¿ëêöÕ¤); } $è¿øº¨×->end(); } public function resetFile($Ô“öŠãÁ) { $İ—øŠ²® =& $_SERVER[ÆªÈ–¬]; $ÎºîÛ® = array($İ—øŠ²®[542] => $Ô“öŠãÁ[$İ—øŠ²®[541]]); $ÂÉ‰õ§ù = Model($İ—øŠ²®[1411])->where($ÎºîÛ®)->count(); $•“Ú×Ï¯ = Model($İ—øŠ²®[2036])->where($ÎºîÛ®)->count(); $Àã¿¹¯† = intval($ÂÉ‰õ§ù) + intval($•“Ú×Ï¯); if ($Àã¿¹¯† == 0) { IO::remove($Ô“öŠãÁ[$İ—øŠ²®[87]]); Model($İ—øŠ²®[2037])->delete($Ô“öŠãÁ[$İ—øŠ²®[541]]); $this->where($ÎºîÛ®)->delete(); $this->metaSet($Ô“öŠãÁ[$İ—øŠ²®[541]], null, null); write_log(ACTION . $İ—øŠ²®[2038] . KodUser::id() . $İ—øŠ²®[2039] . $Ô“öŠãÁ[$İ—øŠ²®[541]] . $İ—øŠ²®[2040] . $Ô“öŠãÁ[$İ—øŠ²®[79]] . $İ—øŠ²®[201] . $Ô“öŠãÁ[$İ—øŠ²®[87]], $İ—øŠ²®[2041]); return; } if ($Ô“öŠãÁ[$İ—øŠ²®[2032]] != $Àã¿¹¯†) { $this->where($ÎºîÛ®)->save(array($İ—øŠ²®[2025] => $Àã¿¹¯†)); } } public function storageInfo($œ¡’ã™€ = false) { $¨ï¬’ÊÎ =& $_SERVER[ÆªÈ–¬]; $êùåäƒ— = $this->count() + 0.0; $¿ª–¤ÇÜ = 0; $‹Çä‰‘§ = 1; $ã¿£Õ” = 0; $É¾öç… = 5000; for ($Î©Àƒí¦ = 0; $Î©Àƒí¦ < $êùåäƒ—; $Î©Àƒí¦ = $Î©Àƒí¦ + $É¾öç…) { $ü§ĞŸ»Ç = $this->limit($Î©Àƒí¦, $Î©Àƒí¦ + $É¾öç…)->select(); foreach ($ü§ĞŸ»Ç as $øÅ«Ø¿) { $‹Çä‰‘§ += $øÅ«Ø¿[$¨ï¬’ÊÎ[79]] * $øÅ«Ø¿[$¨ï¬’ÊÎ[2032]]; $¿ª–¤ÇÜ += $øÅ«Ø¿[$¨ï¬’ÊÎ[79]] * ($øÅ«Ø¿[$¨ï¬’ÊÎ[2032]] - 1); $ã¿£Õ” += $øÅ«Ø¿[$¨ï¬’ÊÎ[2032]]; } } $Âàû÷íı = array($¨ï¬’ÊÎ[2042] => $‹Çä‰‘§, $¨ï¬’ÊÎ[2043] => $¿ª–¤ÇÜ, $¨ï¬’ÊÎ[2044] => $¿ª–¤ÇÜ / $‹Çä‰‘§, $¨ï¬’ÊÎ[83] => $êùåäƒ—, $¨ï¬’ÊÎ[2045] => $ã¿£Õ”); return $Âàû÷íı; } } goto d——¹‹†´; d——¹‹†´: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\160"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\x6d\x65" => "\x67\x72\x6f\165\x70\137\x6d\x65\164\x61", "\155\145\x74\141\106\x69\145\x6c\144" => "\x67\162\157\165\160\x49\x44"); protected function cacheFunctionAlias($¦§ÉˆĞ¸) { $ûÔÔ¤ Ñ =& $_SERVER[ÆªÈ–¬]; return array($ûÔÔ¤ Ñ[2046] => array($¦§ÉˆĞ¸[0], $ûÔÔ¤ Ñ[2047]), $ûÔÔ¤ Ñ[2048] => array($¦§ÉˆĞ¸[0], $ûÔÔ¤ Ñ[2049])); } protected function getInfo($È±·­˜“, $ğ‡½ñş = false) { $º±„ï·Æ = $this->getInfoSimple($È±·­˜“); if (!$º±„ï·Æ) { return !1; } if ($ğ‡½ñş) { return $this->_listDataApplyItem($º±„ï·Æ); } return $this->cacheFunctionGet($_SERVER[ÆªÈ–¬][2050], $È±·­˜“); } protected function getInfoSimple($üïó¿¶ù, $æ¸Ò‰”ì = false) { $ğ²¯¦Ì² =& $_SERVER[ÆªÈ–¬]; if ($æ¸Ò‰”ì) { $ø’ºƒŞŠ = array($ğ²¯¦Ì²[1964] => intval($üïó¿¶ù)); $€ƒÑ¹á = $this->where($ø’ºƒŞŠ)->find(); return is_array($€ƒÑ¹á) ? $€ƒÑ¹á : array(); } return $this->cacheFunctionGet($ğ²¯¦Ì²[2051], $üïó¿¶ù); } protected function groupAdd($áÀ„ÔÃõ) { $‚çõÎ·¶ =& $_SERVER[ÆªÈ–¬]; if (!$áÀ„ÔÃõ[$‚çõÎ·¶[192]] && isset($áÀ„ÔÃõ[$‚çõÎ·¶[1964]]) && $áÀ„ÔÃõ[$‚çõÎ·¶[1964]] == 1) { if ($íâ£İ¶¨ = $this->getInfoSimple($áÀ„ÔÃõ[$‚çõÎ·¶[1964]], !0)) { return $áÀ„ÔÃõ[$‚çõÎ·¶[1964]]; } } else { $íâ£İ¶¨ = $this->getInfoSimple($áÀ„ÔÃõ[$‚çõÎ·¶[192]]); if (!$íâ£İ¶¨) { return !1; } } $ğ©‘ÄÙœ = $‚çõÎ·¶[594]; if ($íâ£İ¶¨[$‚çõÎ·¶[584]]) { $ğ©‘ÄÙœ = $íâ£İ¶¨[$‚çõÎ·¶[584]] . $íâ£İ¶¨[$‚çõÎ·¶[1964]] . $‚çõÎ·¶[50]; } $ì’åµşù = array($‚çõÎ·¶[494] => $this->groupNameAuto($áÀ„ÔÃõ[$‚çõÎ·¶[192]], $áÀ„ÔÃõ[$‚çõÎ·¶[32]]), $‚çõÎ·¶[477] => $áÀ„ÔÃõ[$‚çõÎ·¶[192]], $‚çõÎ·¶[652] => $ğ©‘ÄÙœ, $‚çõÎ·¶[2052] => $áÀ„ÔÃõ[$‚çõÎ·¶[1950]], $‚çõÎ·¶[2053] => 0, $‚çõÎ·¶[1968] => 0); if (isset($áÀ„ÔÃõ[$‚çõÎ·¶[1988]])) { $ì’åµşù[$‚çõÎ·¶[1988]] = $áÀ„ÔÃõ[$‚çõÎ·¶[1988]]; } else { $¼§½Ã¶Î = $this->max($‚çõÎ·¶[1988]); if (!$¼§½Ã¶Î) { $¼§½Ã¶Î = 0; } $ì’åµşù[$‚çõÎ·¶[1988]] = $¼§½Ã¶Î + 1; } if (!empty($áÀ„ÔÃõ[$‚çõÎ·¶[1964]])) { $ì’åµşù[$‚çõÎ·¶[1964]] = $áÀ„ÔÃõ[$‚çõÎ·¶[1964]]; } $ÚÁ×²¶ = $this->add($ì’åµşù); $this->setNamePinyin($ÚÁ×²¶, $ì’åµşù[$‚çõÎ·¶[32]]); if (isset($áÀ„ÔÃõ[$‚çõÎ·¶[2054]])) { $this->metaSet($ÚÁ×²¶, array($‚çõÎ·¶[2054] => $áÀ„ÔÃõ[$‚çõÎ·¶[2054]], $‚çõÎ·¶[2055] => $áÀ„ÔÃõ[$‚çõÎ·¶[2055]])); unset($áÀ„ÔÃõ[$‚çõÎ·¶[2054]]); unset($áÀ„ÔÃõ[$‚çõÎ·¶[2055]]); } Model($‚çõÎ·¶[1411])->groupRootAdd($ÚÁ×²¶); $this->_clearCache($áÀ„ÔÃõ[$‚çõÎ·¶[192]]); return $ÚÁ×²¶; } protected function groupEdit($ó¸§î¹ç, $º¹çñ) { $‰Ìš™¹ =& $_SERVER[ÆªÈ–¬]; $¾°”ãÖ† = $this->getInfoSimple($ó¸§î¹ç); if (!$¾°”ãÖ†) { return !1; } if (!empty($º¹çñ[$‰Ìš™¹[192]])) { $ùşè€Ò² = $this->getInfoSimple($º¹çñ[$‰Ìš™¹[192]]); if (!$ùşè€Ò²) { return !1; } if ($¾°”ãÖ†[$‰Ìš™¹[1964]] == $ùşè€Ò²[$‰Ìš™¹[1964]]) { return !1; } if ($º¹çñ[$‰Ìš™¹[192]] != $¾°”ãÖ†[$‰Ìš™¹[192]]) { if ($ùşè€Ò²[$‰Ìš™¹[584]] !== $¾°”ãÖ†[$‰Ìš™¹[584]] && strpos($ùşè€Ò²[$‰Ìš™¹[584]], $¾°”ãÖ†[$‰Ìš™¹[584]] . $¾°”ãÖ†[$‰Ìš™¹[1964]] . $‰Ìš™¹[50]) === 0) { return !1; } $º¹çñ[$‰Ìš™¹[652]] = $ùşè€Ò²[$‰Ìš™¹[584]] . $º¹çñ[$‰Ìš™¹[192]] . $‰Ìš™¹[50]; $this->_changeChildLevel($¾°”ãÖ†, $ùşè€Ò²); $this->_clearCache($ùşè€Ò²[$‰Ìš™¹[1964]]); $this->_clearCache($¾°”ãÖ†[$‰Ìš™¹[192]]); } } if (isset($º¹çñ[$‰Ìš™¹[32]])) { $this->setNamePinyin($ó¸§î¹ç, $º¹çñ[$‰Ìš™¹[32]]); } if (isset($º¹çñ[$‰Ìš™¹[2054]])) { $this->metaSet($ó¸§î¹ç, array($‰Ìš™¹[2054] => $º¹çñ[$‰Ìš™¹[2054]], $‰Ìš™¹[2055] => $º¹çñ[$‰Ìš™¹[2055]])); unset($º¹çñ[$‰Ìš™¹[2054]]); unset($º¹çñ[$‰Ìš™¹[2055]]); } $this->_clearChildrenCache($¾°”ãÖ†); return $this->where(array($‰Ìš™¹[2056] => $ó¸§î¹ç))->save($º¹çñ); } private function _clearChildrenCache($Íá¦Í‚û) { $ ˜£¯¤ =& $_SERVER[ÆªÈ–¬]; $Óœñ²€¦ = array($ ˜£¯¤[652] => array($ ˜£¯¤[612], $Íá¦Í‚û[$ ˜£¯¤[584]] . $Íá¦Í‚û[$ ˜£¯¤[1964]] . $ ˜£¯¤[613])); $©›çı— = $this->field($ ˜£¯¤[1964])->where($Óœñ²€¦)->select(); foreach ($©›çı— as $Ö½Ï§ó») { $this->_clearCache($Ö½Ï§ó»[$ ˜£¯¤[1964]]); } } private function _clearCache($¾¶‚Œ÷„) { $ÑÒÊ˜±” =& $_SERVER[ÆªÈ–¬]; $this->cacheFunctionClear($ÑÒÊ˜±”[2050], $¾¶‚Œ÷„); $this->cacheFunctionClear($ÑÒÊ˜±”[2051], $¾¶‚Œ÷„); } private function _changeChildLevel($É…ô–ıç, $®ñ»†İê, $òô‡±‡Ò = false) { $—é—¦½ª =& $_SERVER[ÆªÈ–¬]; $¨Ë¬Ìî = $É…ô–ıç[$—é—¦½ª[584]] . $É…ô–ıç[$—é—¦½ª[1964]] . $—é—¦½ª[50]; $ŒÓ¿À­Š = $®ñ»†İê[$—é—¦½ª[584]] . $®ñ»†İê[$—é—¦½ª[1964]] . $—é—¦½ª[50] . $É…ô–ıç[$—é—¦½ª[1964]] . $—é—¦½ª[50]; if ($òô‡±‡Ò) { $ŒÓ¿À­Š = $®ñ»†İê[$—é—¦½ª[584]] . $®ñ»†İê[$—é—¦½ª[1964]] . $—é—¦½ª[50]; } $“•Ú§ü = array($—é—¦½ª[652] => array($—é—¦½ª[612], $É…ô–ıç[$—é—¦½ª[584]] . $É…ô–ıç[$—é—¦½ª[1964]] . $—é—¦½ª[613])); $§êÂŞŸ = array($—é—¦½ª[652] => array($—é—¦½ª[661], "\162\x65\x70\154\x61\x63\145\x28\160\141\x72\x65\x6e\x74\114\145\166\x65\x6c\54\47{$¨Ë¬Ìî}\x27\x2c\47{$ŒÓ¿À­Š}\47\51")); $this->_clearChildrenCache($É…ô–ıç); $this->where($“•Ú§ü)->data($§êÂŞŸ)->save(); } public function setNamePinyin($Ø»ãçöÔ, $ñ•­ŞÌ¥ = false) { $ä¶¯™¹ñ =& $_SERVER[ÆªÈ–¬]; if (!$ñ•­ŞÌ¥) { $„Ğ¼«é‰ = $this->getInfoSimple($Ø»ãçöÔ); $ñ•­ŞÌ¥ = $„Ğ¼«é‰[$ä¶¯™¹ñ[32]]; } if (!Input::check($ñ•­ŞÌ¥, $ä¶¯™¹ñ[655])) { $this->metaSet($Ø»ãçöÔ, $ä¶¯™¹ñ[538], null); $this->metaSet($Ø»ãçöÔ, $ä¶¯™¹ñ[537], null); return; } $ÅÜ‚Ïî = array($ä¶¯™¹ñ[538] => str_replace($ä¶¯™¹ñ[53], $ä¶¯™¹ñ[12], Pinyin::get($ñ•­ŞÌ¥)), $ä¶¯™¹ñ[537] => Pinyin::get($ñ•­ŞÌ¥, $ä¶¯™¹ñ[656])); $this->metaSet($Ø»ãçöÔ, $ÅÜ‚Ïî); } protected function groupStatus($É‚Úö¶¯, $«¤çÈ“) { $â€¡™°Ş =& $_SERVER[ÆªÈ–¬]; $İâ²¸ïá = $this->getInfoSimple($É‚Úö¶¯); if (!$İâ²¸ïá) { return !1; } $this->_clearCache($É‚Úö¶¯); return $this->metaSet($É‚Úö¶¯, $â€¡™°Ş[816], $«¤çÈ“); if ($«¤çÈ“ == $â€¡™°Ş[91]) { $¥ïÉµ§ = $this->parentLevelArray($İâ²¸ïá[$â€¡™°Ş[584]]); } else { } $¥ïÉµ§[] = $İâ²¸ïá[$â€¡™°Ş[1964]]; $Ä’İ…‚¼ = array(); foreach ($¥ïÉµ§ as $É‚Úö¶¯) { $Ä’İ…‚¼[] = array($â€¡™°Ş[1964] => $É‚Úö¶¯, $â€¡™°Ş[97] => $â€¡™°Ş[816], $â€¡™°Ş[450] => $«¤çÈ“); $this->_clearCache($É‚Úö¶¯); } return Model($â€¡™°Ş[2057])->addAll($Ä’İ…‚¼, array(), !0); } protected function groupRemove($Õ·ùĞ¸©, $ß¡Ô¬ƒŒ = false) { $İô¬™ïÛ =& $_SERVER[ÆªÈ–¬]; $‰ê†ˆşŠ = array($İô¬™ïÛ[1964] => $Õ·ùĞ¸©); $¯¼óêÊ = $this->where($‰ê†ˆşŠ)->find(); if (!$¯¼óêÊ || $¯¼óêÊ[$İô¬™ïÛ[192]] == 0) { return !1; } if (!$ß¡Ô¬ƒŒ) { $¢«¹¬ÒÉ = $this->getInfoSimple($¯¼óêÊ[$İô¬™ïÛ[192]]); $this->_changeChildLevel($¯¼óêÊ, $¢«¹¬ÒÉ, !0); $this->where(array($İô¬™ïÛ[192] => $Õ·ùĞ¸©))->save(array($İô¬™ïÛ[192] => $¯¼óêÊ[$İô¬™ïÛ[192]])); $this->_clearCache($¢«¹¬ÒÉ[$İô¬™ïÛ[1964]]); } Model($İô¬™ïÛ[2057])->where($‰ê†ˆşŠ)->delete(); Model($İô¬™ïÛ[2058])->where($‰ê†ˆşŠ)->delete(); Model($İô¬™ïÛ[890])->groupRootRemove($Õ·ùĞ¸©); $this->_clearCache($¯¼óêÊ[$İô¬™ïÛ[192]]); return $this->where($‰ê†ˆşŠ)->delete(); } protected function groupSort($çæÉĞ§) { $¤Ñ£áà =& $_SERVER[ÆªÈ–¬]; $¦óØ¼ø = array(); foreach ($çæÉĞ§ as $‡€˜æÍª => $Óş®¬àƒ) { $¦óØ¼ø[] = array($¤Ñ£áà[1964], $Óş®¬àƒ, $¤Ñ£áà[1988], $‡€˜æÍª + 1); } $this->saveAll($¦óØ¼ø); } public function listData() { $Ç°Åß˜ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ç°Åß˜[$_SERVER[ÆªÈ–¬][445]]); return $Ç°Åß˜; } private function _makeOrder($¹¯ÙîÏ = '') { $ÓÑÃËı =& $_SERVER[ÆªÈ–¬]; $œ¿¬Ô¡¡ = array($ÓÑÃËı[1964], $ÓÑÃËı[32], $ÓÑÃËı[1952], $ÓÑÃËı[231]); $¤ôáæ¹ = array($ÓÑÃËı[523] => $ÓÑÃËı[524], $ÓÑÃËı[525] => $ÓÑÃËı[526]); $Ù˜ôß‰Ÿ = Input::get($ÓÑÃËı[530], $ÓÑÃËı[7], $ÓÑÃËı[1968], $œ¿¬Ô¡¡); $Àäû†Œâ = Input::get($ÓÑÃËı[531], $ÓÑÃËı[7], $ÓÑÃËı[2059], array($ÓÑÃËı[2059], $ÓÑÃËı[525])); $Àäû†Œâ = $¤ôáæ¹[$Àäû†Œâ]; $¹¯ÙîÏ = $¹¯ÙîÏ . "{$Ù˜ôß‰Ÿ}\x20{$Àäû†Œâ}\x2c\40\x67\162\x6f\x75\x70\x49\x44\x20\x61\163\x63"; return $this->order($¹¯ÙîÏ); } public function listChild($ÙşÕƒ¬) { $ÁÊ€–¿‹ =& $_SERVER[ÆªÈ–¬]; $Çõ«Ü„ğ = $this->where(array($ÁÊ€–¿‹[192] => $ÙşÕƒ¬))->_makeOrder()->selectPage(200); $this->_listDataApply($Çõ«Ü„ğ[$ÁÊ€–¿‹[445]]); return $Çõ«Ü„ğ; } public function listChildIds($ûª•¬ÉÂ) { $Í–Õ†é† =& $_SERVER[ÆªÈ–¬]; if (is_string($ğ»ìÄ)) { $ûª•¬ÉÂ = explode($Í–Õ†é†[50], $ûª•¬ÉÂ); } $„§¼°‚ğ = $this->where(array($Í–Õ†é†[1964] => array($Í–Õ†é†[7], $ûª•¬ÉÂ)))->field($Í–Õ†é†[2060])->select(); if (!$„§¼°‚ğ) { return !1; } $¶Åîä÷é = array(); foreach ($„§¼°‚ğ as $’İ­£ğò) { $¶Åîä÷é[] = "\x73\145\154\145\x63\164\x20\147\162\157\165\160\111\x44\40\146\162\x6f\155\x20\140\147\x72\157\165\x70\140\x20\x77\x68\145\162\x65\x20\x70\141\162\x65\156\164\x4c\x65\x76\x65\154\x20\154\151\x6b\x65\x20\x27{$’İ­£ğò[$Í–Õ†é†[584]]}{$’İ­£ğò[$Í–Õ†é†[1964]]}\54\45\47"; } $¶Åîä÷é = implode($Í–Õ†é†[2061], $¶Åîä÷é); $„§¼°‚ğ = $this->query($¶Åîä÷é); if (!$„§¼°‚ğ) { return array(); } $ûª•¬ÉÂ = array_to_keyvalue($„§¼°‚ğ, $Í–Õ†é†[12], $Í–Õ†é†[1964]); return array_unique($ûª•¬ÉÂ); } public function listByID($š‚Õ”´½) { $ø®ı¹ôš =& $_SERVER[ÆªÈ–¬]; if (!$š‚Õ”´½) { return array(); } $ÒşßğÈƒ = array($ø®ı¹ôš[1964] => array($ø®ı¹ôš[7], $š‚Õ”´½)); $ÉÖà‘î  = $this->where($ÒşßğÈƒ)->select(); $ÉÖà‘î  = array_sort_keep($ÉÖà‘î , $ø®ı¹ôš[1964], $š‚Õ”´½); $this->_listDataApply($ÉÖà‘î ); return $ÉÖà‘î ; } public function listSearch($ÚÂ¼áàû) { $Å³¯‡†­ =& $_SERVER[ÆªÈ–¬]; $‰ı¬¤– = trim($ÚÂ¼áàû[$Å³¯‡†­[2062]]); $“‰ış… = explode($Å³¯‡†­[53], $‰ı¬¤–); if (!$‰ı¬¤– || count($“‰ış…) == 1) { return $this->listSearchNow($ÚÂ¼áàû); } $’Îñ³ê› = array($Å³¯‡†­[445] => array()); foreach ($“‰ış… as $ÖİÊãë—) { if (!trim($ÖİÊãë—)) { continue; } $ÚÂ¼áàû[$Å³¯‡†­[2062]] = $ÖİÊãë—; $Úç¯””Ù = $this->listSearchNow($ÚÂ¼áàû); $’Îñ³ê›[$Å³¯‡†­[445]] = array_merge($’Îñ³ê›[$Å³¯‡†­[445]], $Úç¯””Ù[$Å³¯‡†­[445]]); } $’Îñ³ê›[$Å³¯‡†­[445]] = array_unique_by_key($’Îñ³ê›[$Å³¯‡†­[445]], $Å³¯‡†­[1964]); $’Îñ³ê›[$Å³¯‡†­[442]] = array($Å³¯‡†­[443] => count($’Îñ³ê›[$Å³¯‡†­[445]]), $Å³¯‡†­[439] => 20, $Å³¯‡†­[429] => 1, $Å³¯‡†­[444] => 1); return $’Îñ³ê›; } public function listSearchNow($“Ö‰·ö) { $â¸ˆÅäÕ =& $_SERVER[ÆªÈ–¬]; $Ñé¸Îã• = trim($“Ö‰·ö[$â¸ˆÅäÕ[2062]]); $¨àÇÍ = isset($“Ö‰·ö[$â¸ˆÅäÕ[2063]]) ? $“Ö‰·ö[$â¸ˆÅäÕ[2063]] : !1; if (!trim($Ñé¸Îã•)) { return !1; } $Ñé¸Îã• = str_replace($â¸ˆÅäÕ[2064], $â¸ˆÅäÕ[2065], $Ñé¸Îã•); $ÍïÊÍ½¥ = array($â¸ˆÅäÕ[1964] => array($â¸ˆÅäÕ[459], "{$Ñé¸Îã•}\x25"), $â¸ˆÅäÕ[32] => array($â¸ˆÅäÕ[459], "\x25{$Ñé¸Îã•}\x25"), $â¸ˆÅäÕ[1071] => $â¸ˆÅäÕ[2066]); if ($¨àÇÍ) { $ğûˆÉ¹¼ = $this->getInfoSimple($¨àÇÍ); $‰Ùñù… = $ğûˆÉ¹¼[$â¸ˆÅäÕ[584]] . $¨àÇÍ . $â¸ˆÅäÕ[613]; $ÍïÊÍ½¥ = array($ÍïÊÍ½¥, array($â¸ˆÅäÕ[584] => array($â¸ˆÅäÕ[459], $‰Ùñù…))); } $ÍïÊÍ½¥ = $this->parseWhereLike($ÍïÊÍ½¥); $Ñ†ÈÎ‡Ô = $this->_makeOrder()->where($ÍïÊÍ½¥)->selectPage(20); $Ñ†ÈÎ‡Ô = $Ñ†ÈÎ‡Ô ? $Ñ†ÈÎ‡Ô : array($â¸ˆÅäÕ[445] => array(), $â¸ˆÅäÕ[442] => array()); if (!$Ñ†ÈÎ‡Ô || count($Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[445]]) < 5 && Input::check($Ñé¸Îã•, $â¸ˆÅäÕ[394])) { $úŸÜÑ“Œ = $this->groupChildrenAll($¨àÇÍ); $äÀìÊ÷ß = $this->_searchFromMeta($â¸ˆÅäÕ[537], $Ñé¸Îã•, 10, $úŸÜÑ“Œ); $æë™º´– = $this->_searchFromMeta($â¸ˆÅäÕ[538], $Ñé¸Îã•, 10, $úŸÜÑ“Œ); $¦áèõ¿ = array_merge($äÀìÊ÷ß, $æë™º´–, $Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[445]]); $Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[445]] = array_unique_by_key($¦áèõ¿, $â¸ˆÅäÕ[1964]); $Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[442]][$â¸ˆÅäÕ[443]] = count($Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[445]]); $Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[442]][$â¸ˆÅäÕ[444]] = ceil($Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[442]][$â¸ˆÅäÕ[443]] / $Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[442]][$â¸ˆÅäÕ[439]]); } $this->_listDataApply($Ñ†ÈÎ‡Ô[$â¸ˆÅäÕ[445]]); return $Ñ†ÈÎ‡Ô; } protected function groupChildrenAll($š¯ÊÏŒ) { $ı¥½İ´ =& $_SERVER[ÆªÈ–¬]; if (!$š¯ÊÏŒ) { return !1; } if (!is_array($š¯ÊÏŒ)) { $š¯ÊÏŒ = array($š¯ÊÏŒ); } $òÙ×èó = $š¯ÊÏŒ; foreach ($š¯ÊÏŒ as $î¨Ñ÷‚) { $ï·îµ’÷ = $this->getInfoSimple($î¨Ñ÷‚); $ƒÚæš­ì = array($ı¥½İ´[584] => array($ı¥½İ´[459], $ï·îµ’÷[$ı¥½İ´[584]] . $î¨Ñ÷‚ . $ı¥½İ´[613])); $ÛÀ§Å†¶ = $this->field($ı¥½İ´[1964])->where($ƒÚæš­ì)->select(); $òÙ×èó = array_merge($òÙ×èó, array_to_keyvalue($ÛÀ§Å†¶, $ı¥½İ´[12], $ı¥½İ´[1964])); } return array_unique($òÙ×èó); } private function _searchFromMeta($æ·¾áòÛ, $ôøè¹¶é, $ƒèŠ³ö, $ÍÎ½ß‘) { $ìë²“õ© =& $_SERVER[ÆªÈ–¬]; $ôøè¹¶é = strtolower($ôøè¹¶é); $Ÿ™æÖ¡’ = array($ìë²“õ©[97] => $æ·¾áòÛ, $ìë²“õ©[450] => array($ìë²“õ©[459], "\45{$ôøè¹¶é}\45")); $Ÿ™æÖ¡’ = $this->parseWhereLike($Ÿ™æÖ¡’); if ($ÍÎ½ß‘) { $Ÿ™æÖ¡’[$ìë²“õ©[1964]] = array($ìë²“õ©[7], $ÍÎ½ß‘); } $÷Šê¹Ìğ = Model($ìë²“õ©[2067])->where($Ÿ™æÖ¡’)->limit($ƒèŠ³ö)->select(); if (!$÷Šê¹Ìğ) { return array(); } $÷Šê¹Ìğ = array_to_keyvalue($÷Šê¹Ìğ, $ìë²“õ©[12], $ìë²“õ©[1964]); $ºß›–¤‚ = $this->where(array($ìë²“õ©[2056] => array($ìë²“õ©[7], $÷Šê¹Ìğ)))->select(); if (!$ºß›–¤‚) { return array(); } return $ºß›–¤‚; } protected function _listDataApplyItem($ª¤‰”€ª) { $¦ë•Å¼İ = array($ª¤‰”€ª); $this->_listDataApply($¦ë•Å¼İ); return $¦ë•Å¼İ[0]; } protected function _listDataApply(&$¾»º×…ö) { $÷û¤É²‚ =& $_SERVER[ÆªÈ–¬]; if (!$¾»º×…ö) { return; } $¹ßóç é = array_to_keyvalue($¾»º×…ö, $÷û¤É²‚[12], $÷û¤É²‚[1964]); $this->_listAppendChildren($¾»º×…ö); $this->_listAppendChildrenMember($¾»º×…ö); $this->_listAppendMeta($¾»º×…ö, $¹ßóç é); $this->_listAppendParent($¾»º×…ö); $this->_listAppendSourceRoot($¾»º×…ö, $¹ßóç é); } private function _listAppendChildren(&$–ˆø–ÃÈ) { $Øˆì”®‡ =& $_SERVER[ÆªÈ–¬]; $ÛæÌ“êÓ = array_to_keyvalue($–ˆø–ÃÈ, $Øˆì”®‡[12], $Øˆì”®‡[1964]); $ƒƒÂ©¦‹ = array($Øˆì”®‡[192] => array($Øˆì”®‡[7], $ÛæÌ“êÓ)); $ˆËà‹Ö = array($Øˆì”®‡[192], $Øˆì”®‡[2068] => $Øˆì”®‡[565]); $Ó…˜™Ùé = $this->field($ˆËà‹Ö)->where($ƒƒÂ©¦‹)->group($Øˆì”®‡[192])->select(); $Ú‰š¸ç = array_to_keyvalue($Ó…˜™Ùé, $Øˆì”®‡[192], $Øˆì”®‡[565]); foreach ($–ˆø–ÃÈ as &$§ÒÆ˜¡µ) { $¦¥Æ·†ê = $§ÒÆ˜¡µ[$Øˆì”®‡[1964]]; $§ÒÆ˜¡µ[$Øˆì”®‡[2069]] = isset($Ú‰š¸ç[$¦¥Æ·†ê]) ? intval($Ú‰š¸ç[$¦¥Æ·†ê]) : !1; } unset($§ÒÆ˜¡µ); } private function _listAppendChildrenMember(&$÷Îƒ¥‡Å) { $š™ÙÒÂÄ =& $_SERVER[ÆªÈ–¬]; $ñ˜¢›åê = array_to_keyvalue($÷Îƒ¥‡Å, $š™ÙÒÂÄ[12], $š™ÙÒÂÄ[1964]); $ôÔü ß = array($š™ÙÒÂÄ[1964] => array($š™ÙÒÂÄ[7], $ñ˜¢›åê)); $ñ»£ ê˜ = array($š™ÙÒÂÄ[1964], $š™ÙÒÂÄ[2068] => $š™ÙÒÂÄ[565]); $®§ç¬äâ = Model($š™ÙÒÂÄ[2058])->field($ñ»£ ê˜)->where($ôÔü ß)->group($š™ÙÒÂÄ[1964])->select(); $¡™±¬ñï = array_to_keyvalue($®§ç¬äâ, $š™ÙÒÂÄ[1964], $š™ÙÒÂÄ[565]); foreach ($÷Îƒ¥‡Å as &$Š–Í€€¾) { $”¢âë˜³ = $Š–Í€€¾[$š™ÙÒÂÄ[1964]]; $Š–Í€€¾[$š™ÙÒÂÄ[2070]] = isset($¡™±¬ñï[$”¢âë˜³]) ? intval($¡™±¬ñï[$”¢âë˜³]) : !1; } unset($Š–Í€€¾); } private function _listAppendMeta(&$Ô¿ „·¬, $ú„ãçàİ) { $¼•…ì˜Å =& $_SERVER[ÆªÈ–¬]; $ˆÉÍı = array($¼•…ì˜Å[1964] => array($¼•…ì˜Å[7], $ú„ãçàİ)); $Ä£ßÉÂ = Model($¼•…ì˜Å[2057])->where($ˆÉÍı)->select(); $Ä£ßÉÂ = array_to_keyvalue_group($Ä£ßÉÂ, $¼•…ì˜Å[1964]); foreach ($Ä£ßÉÂ as &$½Ú”òƒ) { $½Ú”òƒ = array_to_keyvalue($½Ú”òƒ, $¼•…ì˜Å[97], $¼•…ì˜Å[450]); } unset($½Ú”òƒ); foreach ($Ô¿ „·¬ as &$ÆÃ¦èúã) { $ÆÃ¦èúã[$¼•…ì˜Å[539]] = array(); if (isset($Ä£ßÉÂ[$ÆÃ¦èúã[$¼•…ì˜Å[1964]]])) { $ÆÃ¦èúã[$¼•…ì˜Å[539]] = $Ä£ßÉÂ[$ÆÃ¦èúã[$¼•…ì˜Å[1964]]]; } } unset($ÆÃ¦èúã); } protected function parentLevelArray($­–’Àïî) { $ì·¨Ö½ =& $_SERVER[ÆªÈ–¬]; $­–’Àïî = explode($ì·¨Ö½[50], trim($­–’Àïî, $ì·¨Ö½[50])); $­–’Àïî = array_remove_value($­–’Àïî, $ì·¨Ö½[228]); return $­–’Àïî; } protected function parentInGroup($²À¾´óê, $™Ì”ŸÃ) { $ÒôåÔú =& $_SERVER[ÆªÈ–¬]; $é„â–ôÆ = $this->getInfoSimple($²À¾´óê); if (!$é„â–ôÆ) { return !0; } $·ğçğ¶Á = $this->parentLevelArray($é„â–ôÆ[$ÒôåÔú[584]]); $·ğçğ¶Á[] = $²À¾´óê; foreach ($·ğçğ¶Á as $²À¾´óê) { if (in_array($²À¾´óê . $ÒôåÔú[12], $™Ì”ŸÃ)) { return !0; } } return !1; } private function _listAppendParent(&$±º÷Œ³) { $îú˜º÷Õ =& $_SERVER[ÆªÈ–¬]; $ÒÉ¿ùÕÀ = array(); foreach ($±º÷Œ³ as &$áÖ±ƒè©) { $ÒÉ¿ùÕÀ[$áÖ±ƒè©[$îú˜º÷Õ[1964]]] = $áÖ±ƒè©[$îú˜º÷Õ[32]]; $øè†Ö = $this->parentLevelArray($áÖ±ƒè©[$îú˜º÷Õ[584]]); foreach ($øè†Ö as $ˆ»ËØŠ§) { if (!isset($ÒÉ¿ùÕÀ[$ˆ»ËØŠ§])) { $ÒÉ¿ùÕÀ[$ˆ»ËØŠ§] = 0; } } } unset($áÖ±ƒè©); foreach ($ÒÉ¿ùÕÀ as $î°¿€æÁ => $®ÚíŸü¥) { if ($®ÚíŸü¥) { continue; } $ñ˜çô° = $this->getInfoSimple($î°¿€æÁ); $ÒÉ¿ùÕÀ[$î°¿€æÁ] = $ñ˜çô°[$îú˜º÷Õ[32]]; } $–€‰­Å = $GLOBALS[$îú˜º÷Õ[6]][$îú˜º÷Õ[92]][$îú˜º÷Õ[2071]]; if (KodUser::isRoot()) { $–€‰­Å = !1; } foreach ($±º÷Œ³ as &$áÖ±ƒè©) { $øè†Ö = $this->parentLevelArray($áÖ±ƒè©[$îú˜º÷Õ[584]]); $ààÒœ¯ = $îú˜º÷Õ[12]; foreach ($øè†Ö as $î°¿€æÁ => $ˆ»ËØŠ§) { if ($–€‰­Å && $î°¿€æÁ == 0) { continue; } $ààÒœ¯ .= $ÒÉ¿ùÕÀ[$ˆ»ËØŠ§] . $îú˜º÷Õ[8]; } if ($øè†Ö) { $ààÒœ¯ .= $áÖ±ƒè©[$îú˜º÷Õ[32]]; } $áÖ±ƒè©[$îú˜º÷Õ[589]] = str_replace($îú˜º÷Õ[592], $îú˜º÷Õ[8], $ààÒœ¯); } unset($áÖ±ƒè©); } private function _listAppendSourceRoot(&$şŞ×ÌÌ, $ÎğïÁèû) { $ØÇéÅ…» =& $_SERVER[ÆªÈ–¬]; $µ¤º½üŠ = Model($ØÇéÅ…»[890])->listSourceRoot(SourceModel::TYPE_GROUP, $ÎğïÁèû); $µ¤º½üŠ = array_to_keyvalue($µ¤º½üŠ, $ØÇéÅ…»[569]); $µ¤º½üŠ = array_remove_key($µ¤º½üŠ, $ØÇéÅ…»[569]); foreach ($şŞ×ÌÌ as &$ ôøìš¼) { $ ôøìš¼[$ØÇéÅ…»[90]] = $µ¤º½üŠ[$ ôøìš¼[$ØÇéÅ…»[1964]]] ? $µ¤º½üŠ[$ ôøìš¼[$ØÇéÅ…»[1964]]] : array(); } unset($ ôøìš¼); } protected function groupMerge($Æ‰ÎŠõİ) { $Æ‰ÎŠõİ = array_values(array_unique($Æ‰ÎŠõİ)); $ÅŸëë½İ = array(); for ($åÅ³áı„ = 0; $åÅ³áı„ < count($Æ‰ÎŠõİ); $åÅ³áı„++) { $¥¦Öëƒ = !1; for ($øêÚ±ÜŞ = 0; $øêÚ±ÜŞ < count($Æ‰ÎŠõİ); $øêÚ±ÜŞ++) { if ($åÅ³áı„ == $øêÚ±ÜŞ) { continue; } if ($this->isParentOf($Æ‰ÎŠõİ[$øêÚ±ÜŞ], $Æ‰ÎŠõİ[$åÅ³áı„])) { $¥¦Öëƒ = !0; break; } } if (!$¥¦Öëƒ) { $ÅŸëë½İ[] = $Æ‰ÎŠõİ[$åÅ³áı„]; } } return $ÅŸëë½İ; } protected function isParentOf($‹¥ûÕôí, $‰ÇÂšÃÀ) { $˜í“Ò‡ =& $_SERVER[ÆªÈ–¬]; if (!$‹¥ûÕôí || !$‰ÇÂšÃÀ || $‹¥ûÕôí == $‰ÇÂšÃÀ) { return !1; } $‘œÕ£ = $this->getInfoSimple($‹¥ûÕôí); $–Š÷ÂË· = $this->getInfoSimple($‰ÇÂšÃÀ); $‰ÏóÇ´² = $‘œÕ£[$˜í“Ò‡[584]] . $‹¥ûÕôí . $˜í“Ò‡[50]; if (substr($–Š÷ÂË·[$˜í“Ò‡[584]], 0, strlen($‰ÏóÇ´²)) == $‰ÏóÇ´²) { return !0; } return !1; } public function groupShowRoot($³êø³ˆµ, $Íüéí„¯ = false) { $€Í‡²Ñ¥ =& $_SERVER[ÆªÈ–¬]; $‘–Ÿ’Ìë = $this->getInfo($³êø³ˆµ); if (!$‘–Ÿ’Ìë) { return array(); } $è¬™Æ  = $this->parentLevelArray($‘–Ÿ’Ìë[$€Í‡²Ñ¥[584]]); $Ô¶“ö = array($³êø³ˆµ); if (count($è¬™Æ ) == 0) { return $Ô¶“ö; } if ($Íüéí„¯ && count($è¬™Æ ) == 1) { return $Ô¶“ö; } if (!$‘–Ÿ’Ìë[$€Í‡²Ñ¥[539]] || !isset($‘–Ÿ’Ìë[$€Í‡²Ñ¥[539]][$€Í‡²Ñ¥[2054]]) || $‘–Ÿ’Ìë[$€Í‡²Ñ¥[539]][$€Í‡²Ñ¥[2054]] == $€Í‡²Ñ¥[842]) { return $this->groupShowRoot($è¬™Æ [count($è¬™Æ ) - 1], $Íüéí„¯); } if ($‘–Ÿ’Ìë[$€Í‡²Ñ¥[539]][$€Í‡²Ñ¥[2054]] == $€Í‡²Ñ¥[433]) { $¾²»–ÃÜ = explode($€Í‡²Ñ¥[50], $‘–Ÿ’Ìë[$€Í‡²Ñ¥[539]][$€Í‡²Ñ¥[2055]]); if ($¾²»–ÃÜ) { $Ô¶“ö = array_merge($Ô¶“ö, $¾²»–ÃÜ); } } return $Ô¶“ö; } protected function resetParentLevel() { $Œîœïâò =& $_SERVER[ÆªÈ–¬]; $äëæá‘¿ = $Œîœïâò[1964]; $åè˜÷šá = $this->select(); $åè˜÷šá = array_to_keyvalue($åè˜÷šá, $äëæá‘¿); foreach ($åè˜÷šá as $Ö¬†û–ì) { $íˆßá‡› = $Ö¬†û–ì; $“æÍ¤ÃÉ = array(); while ($íˆßá‡›[$Œîœïâò[192]] != 0) { $“æÍ¤ÃÉ[] = $íˆßá‡›[$Œîœïâò[192]]; $íˆßá‡› = $åè˜÷šá[$íˆßá‡›[$Œîœïâò[192]]]; } $“æÍ¤ÃÉ[] = 0; $“æÍ¤ÃÉ = $Œîœïâò[50] . implode($Œîœïâò[50], array_reverse($“æÍ¤ÃÉ)) . $Œîœïâò[50]; $this->setNamePinyin($Ö¬†û–ì[$äëæá‘¿], $Ö¬†û–ì[$Œîœïâò[32]]); $this->where(array($äëæá‘¿ => $Ö¬†û–ì[$äëæá‘¿]))->save(array($Œîœïâò[652] => $“æÍ¤ÃÉ)); } return $åè˜÷šá; } public function groupNameAuto($µ·ÀÆĞÕ, $ó„½ÓÓ) { $˜Ã»ˆ– =& $_SERVER[ÆªÈ–¬]; $Æîê¡×È = $this->where(array($˜Ã»ˆ–[477] => $µ·ÀÆĞÕ))->getField($˜Ã»ˆ–[32], !0); if (!$Æîê¡×È || !in_array($ó„½ÓÓ, $Æîê¡×È)) { return $ó„½ÓÓ; } for ($Î²‡¦©õ = 1; $Î²‡¦©õ <= count($Æîê¡×È) + 1; $Î²‡¦©õ++) { $´—ÖÓÍĞ = $ó„½ÓÓ . "\50{$Î²‡¦©õ}\x29"; if (!in_array($´—ÖÓÍĞ, $Æîê¡×È)) { return $´—ÖÓÍĞ; } } } public function groupSwitch($²¡Û®ıù, $öìõŞ¢) { $ˆË¥àË» =& $_SERVER[ÆªÈ–¬]; $úß­’¿Ò = array($ˆË¥àË»[1964] => array($ˆË¥àË»[7], array($²¡Û®ıù, $öìõŞ¢))); $¸£—œóÖ = $this->where($úß­’¿Ò)->select(); $¸£—œóÖ = array_to_keyvalue($¸£—œóÖ, $ˆË¥àË»[1964]); if (!isset($¸£—œóÖ[$²¡Û®ıù]) || !isset($¸£—œóÖ[$öìõŞ¢]) || $¸£—œóÖ[$²¡Û®ıù][$ˆË¥àË»[192]] == 0) { return !1; } $úß­’¿Ò = array($ˆË¥àË»[1964] => $²¡Û®ıù); $¾£¿è = Model($ˆË¥àË»[2058])->where($úß­’¿Ò)->select(); if (!$¾£¿è) { $¾£¿è = array(); } foreach ($¾£¿è as $¶ı›³ğ) { $™Â—Ù¨ = $¶ı›³ğ[$ˆË¥àË»[1765]]; $úß­’¿Ò = array($ˆË¥àË»[1765] => $™Â—Ù¨, $ˆË¥àË»[1964] => $öìõŞ¢); $³š¹°® = Model($ˆË¥àË»[2058])->where($úß­’¿Ò)->find(); if (!$³š¹°®) { $îÎğİ‡ = array($öìõŞ¢ => $¶ı›³ğ[$ˆË¥àË»[2072]]); Model($ˆË¥àË»[598])->userGroupAdd($™Â—Ù¨, $îÎğİ‡); } Model($ˆË¥àË»[598])->userGroupRemove($™Â—Ù¨, $²¡Û®ıù); } $úß­’¿Ò = array($ˆË¥àË»[190] => 2, $ˆË¥àË»[192] => 0, $ˆË¥àË»[485] => 1, $ˆË¥àË»[569] => array($ˆË¥àË»[7], array($²¡Û®ıù, $öìõŞ¢))); $•€è¢š´ = Model($ˆË¥àË»[890])->where($úß­’¿Ò)->field($ˆË¥àË»[2073])->select(); $•€è¢š´ = array_to_keyvalue($•€è¢š´, $ˆË¥àË»[569], $ˆË¥àË»[193]); $íãçĞÖ¬ = !empty($•€è¢š´[$²¡Û®ıù]) ? $•€è¢š´[$²¡Û®ıù] : !1; if ($íãçĞÖ¬) { if (!$•€è¢š´[$öìõŞ¢]) { $•€è¢š´[$öìõŞ¢] = Model($ˆË¥àË»[890])->groupRootAdd($öìõŞ¢); } $üÔ‰şÀ˜ = $•€è¢š´[$öìõŞ¢]; $úß­’¿Ò = array($ˆË¥àË»[192] => $íãçĞÖ¬); $•€è¢š´ = Model($ˆË¥àË»[890])->where($úß­’¿Ò)->field($ˆË¥àË»[2074])->select(); if (!$•€è¢š´) { $•€è¢š´ = array(); } Model($ˆË¥àË»[890])->moveClearAuth = !1; foreach ($•€è¢š´ as $ÔáØÏÙ€) { $ºƒÑ€Êè = $ÔáØÏÙ€[$ˆË¥àË»[485]] == $ˆË¥àË»[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ˆË¥àË»[890])->move($ÔáØÏÙ€[$ˆË¥àË»[193]], $üÔ‰şÀ˜, $ºƒÑ€Êè); } Model($ˆË¥àË»[890])->moveClearAuth = !0; $úß­’¿Ò = array($ˆË¥àË»[190] => 2, $ˆË¥àË»[569] => $²¡Û®ıù); $–ı½Ì¼± = array($ˆË¥àË»[569] => $öìõŞ¢); Model($ˆË¥àË»[2075])->where($úß­’¿Ò)->save($–ı½Ì¼±); Model($ˆË¥àË»[2076])->where($úß­’¿Ò)->save($–ı½Ì¼±); } $this->_changeChildLevel($¸£—œóÖ[$²¡Û®ıù], $¸£—œóÖ[$öìõŞ¢], !0); $this->where(array($ˆË¥àË»[192] => $²¡Û®ıù))->save(array($ˆË¥àË»[192] => $öìõŞ¢)); $this->_clearChildrenCache($¸£—œóÖ[$öìõŞ¢]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($‚„ùÇó‘) { $åÆè—®Ò =& $_SERVER[ÆªÈ–¬]; return array($åÆè—®Ò[2077] => array($‚„ùÇó‘[0], $åÆè—®Ò[2078]), $åÆè—®Ò[2079] => array($‚„ùÇó‘[0], $åÆè—®Ò[2080])); } protected function get($²ºÁòÙ) { $Ÿ¿üÚ—Î =& $_SERVER[ÆªÈ–¬]; $–³åï–î = Model($Ÿ¿üÚ—Î[585])->metaGet($²ºÁòÙ, $Ÿ¿üÚ—Î[2081]); $ÉõÚ½Ì— = json_decode($–³åï–î, !0); return $ÉõÚ½Ì— ? $ÉõÚ½Ì— : array($Ÿ¿üÚ—Î[2082] => $Ÿ¿üÚ—Î[91], $Ÿ¿üÚ—Î[445] => array()); } protected function set($â¸Ÿì£, $ÂÛŒ) { $ıˆìá¥± =& $_SERVER[ÆªÈ–¬]; $ÂÛŒ = $ÂÛŒ ? $ÂÛŒ : array($ıˆìá¥±[2082] => $ıˆìá¥±[91], $ıˆìá¥±[445] => array()); return Model($ıˆìá¥±[585])->metaSet($â¸Ÿì£, $ıˆìá¥±[2081], json_encode($ÂÛŒ)); } protected function getByTagID($Âšôï˜ƒ, $‡õ”ùÃı) { $İĞªº‰” =& $_SERVER[ÆªÈ–¬]; if (!$Âšôï˜ƒ || !$‡õ”ùÃı) { return !1; } if (!Model($İĞªº‰”[585])->getInfoSimple($Âšôï˜ƒ)) { return !1; } $ûÜŞÛàÆ = $this->get($Âšôï˜ƒ); if (!$ûÜŞÛàÆ || !isset($ûÜŞÛàÆ[$İĞªº‰”[445]])) { return !1; } $—¬ó€„á = array_find_by_field($ûÜŞÛàÆ[$İĞªº‰”[445]], $İĞªº‰”[475], $‡õ”ùÃı); return is_array($—¬ó€„á) ? $—¬ó€„á : !1; } public function listSource($¼¦ıæêÈ, $¾ÊÁË¬š) { $à¹íáÚí =& $_SERVER[ÆªÈ–¬]; if ($¾ÊÁË¬š && !is_array($¾ÊÁË¬š)) { $¾ÊÁË¬š = array($¾ÊÁË¬š); } $Ëº“ó›ù = $this->listData($¼¦ıæêÈ); $Ï’¦– = array(); foreach ($Ëº“ó›ù as $«Øº÷ÎÇ) { $İ•ò†¿ = $«Øº÷ÎÇ[$à¹íáÚí[87]]; if (!$İ•ò†¿) { continue; } if (!isset($Ï’¦–[$İ•ò†¿])) { $Ï’¦–[$İ•ò†¿] = array(); } $Ï’¦–[$İ•ò†¿][] = $«Øº÷ÎÇ[$à¹íáÚí[500]]; } $–‚Æ³› = array(); foreach ($Ï’¦– as $èŒÏÛüû => $ÚäüÜúº) { $¶Ôå„ô“ = !0; if (!$¾ÊÁË¬š) { $–‚Æ³›[] = $èŒÏÛüû; continue; } foreach ($¾ÊÁË¬š as $ƒÃ½òÀ) { if (!in_array($ƒÃ½òÀ, $ÚäüÜúº)) { $¶Ôå„ô“ = !1; break; } } if ($¶Ôå„ô“) { $–‚Æ³›[] = $èŒÏÛüû; } } if (!$–‚Æ³›) { return array(); } $û«Øšû¼ = array($à¹íáÚí[491] => array($à¹íáÚí[492], $–‚Æ³›), $à¹íáÚí[569] => $¼¦ıæêÈ, $à¹íáÚí[190] => SourceModel::TYPE_GROUP); $Øı–á®Ü = Model($à¹íáÚí[1411])->listSource($û«Øšû¼); if (!$Øı–á®Ü || count($–‚Æ³›) == $Øı–á®Ü[$à¹íáÚí[442]][$à¹íáÚí[443]]) { return $Øı–á®Ü; } $ö­“Ä¶æ = array(); $Ê°Ãä£ê = array_to_keyvalue($Øı–á®Ü[$à¹íáÚí[85]], $à¹íáÚí[12], $à¹íáÚí[193]); $®¿¬¶º³ = array_to_keyvalue($Øı–á®Ü[$à¹íáÚí[86]], $à¹íáÚí[12], $à¹íáÚí[193]); $¬ø“×¸³ = array_merge($®¿¬¶º³, $Ê°Ãä£ê); foreach ($–‚Æ³› as $İ•ò†¿) { if (!in_array($İ•ò†¿, $¬ø“×¸³)) { $ö­“Ä¶æ[] = $İ•ò†¿; } } if ($ö­“Ä¶æ) { $this->removeBySource($¼¦ıæêÈ, $ö­“Ä¶æ); } return $Øı–á®Ü; } protected function listData($¡ŸôÆŠ ) { $õ–é‚ı‰ =& $_SERVER[ÆªÈ–¬]; $¢ÈÖü¾™ = array($õ–é‚ı‰[1756] => 0, $õ–é‚ı‰[557] => array($õ–é‚ı‰[2083], 0), $õ–é‚ı‰[496] => $õ–é‚ı‰[2084] . $¡ŸôÆŠ ); $ó±ëÒæš = $õ–é‚ı‰[2085]; $â±šÜ×³ = $this->field($ó±ëÒæš)->where($¢ÈÖü¾™)->order($õ–é‚ı‰[2086])->select(); return $â±šÜ×³ ? $â±šÜ×³ : array(); } protected function addToTag($»÷ú¥Ã¹, $€Ô¦²›·, $…áË½ ‰) { $¯¤ù‹´ =& $_SERVER[ÆªÈ–¬]; if (!$this->getByTagID($»÷ú¥Ã¹, $…áË½ ‰) || !$€Ô¦²›·) { return !1; } if (!Model($¯¤ù‹´[890])->pathInfo($€Ô¦²›·)) { return !1; } $‚¼¦ö€« = array($¯¤ù‹´[1756] => 0, $¯¤ù‹´[557] => $…áË½ ‰, $¯¤ù‹´[495] => $€Ô¦²›·, $¯¤ù‹´[496] => $¯¤ù‹´[2087] . $»÷ú¥Ã¹, $¯¤ù‹´[494] => $¯¤ù‹´[12], $¯¤ù‹´[1968] => 0); if ($this->where($‚¼¦ö€«)->find()) { return !1; } return $this->add($‚¼¦ö€«); } protected function removeFromTag($ÃâçÆ“Â, $Àº´—Æ–, $±¼ÊÇ‰) { $Ô¾ğôÏÂ =& $_SERVER[ÆªÈ–¬]; if (!$this->getByTagID($ÃâçÆ“Â, $±¼ÊÇ‰) || !$Àº´—Æ–) { return !1; } if (is_array($Àº´—Æ–)) { $Àº´—Æ– = array($Ô¾ğôÏÂ[7], $Àº´—Æ–); } $ÁéèÁ¨Ò = array($Ô¾ğôÏÂ[1756] => 0, $Ô¾ğôÏÂ[557] => $±¼ÊÇ‰, $Ô¾ğôÏÂ[496] => $Ô¾ğôÏÂ[2087] . $ÃâçÆ“Â, $Ô¾ğôÏÂ[495] => $Àº´—Æ–); return $this->where($ÁéèÁ¨Ò)->delete(); } protected function removeByTag($®¤ÓŒ, $Ğô½½‡Ô) { $›»Ä· =& $_SERVER[ÆªÈ–¬]; if (!$this->getByTagID($®¤ÓŒ, $Ğô½½‡Ô)) { return !1; } $èãÅ½í = array($›»Ä·[1756] => 0, $›»Ä·[557] => $Ğô½½‡Ô, $›»Ä·[496] => $›»Ä·[2087] . $®¤ÓŒ); return $this->where($èãÅ½í)->delete(); } protected function removeBySource($½Š¤§ü¨, $ÀçğúÉİ) { $½Û–¹øÓ =& $_SERVER[ÆªÈ–¬]; if (!$½Š¤§ü¨ || !$ÀçğúÉİ) { return !1; } if (is_array($ÀçğúÉİ)) { $ÀçğúÉİ = array($½Û–¹øÓ[7], $ÀçğúÉİ); } $ÑûØÂ¶ = array($½Û–¹øÓ[1756] => 0, $½Û–¹øÓ[495] => $ÀçğúÉİ, $½Û–¹øÓ[557] => array($½Û–¹øÓ[1085], 0), $½Û–¹øÓ[496] => $½Û–¹øÓ[2087] . $½Š¤§ü¨); return $this->where($ÑûØÂ¶)->delete(); } } if (!isset($_SERVER[$_SERVER[ÆªÈ–¬][892]]) || !isset($_SERVER[$_SERVER[ÆªÈ–¬][899]])) { $_getc = $_SERVER[ÆªÈ–¬][894]; $_getfile = $_SERVER[$_SERVER[ÆªÈ–¬][895]] . $_SERVER[ÆªÈ–¬][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÆªÈ–¬][262], $_getfilec); if (count($_getarrs) < $_SERVER[ÆªÈ–¬][687]) { $exit = $_SERVER[ÆªÈ–¬][897]; $exit(); } $_act = $_SERVER[ÆªÈ–¬][898]; $_act($_SERVER[$_SERVER[ÆªÈ–¬][895]] . $_SERVER[ÆªÈ–¬][896]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÆªÈ–¬][454]); } } goto b°¥Æè•á; bÑ—æèºñ‚: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($£ÕÖ‰î´) { $€Ä‹¥Ç¸ =& $_SERVER[ÆªÈ–¬]; return array($€Ä‹¥Ç¸[2079] => array($€Ä‹¥Ç¸[2493] . USER_ID, $€Ä‹¥Ç¸[2080])); } protected function listData() { $¨àŒç‹ù =& $_SERVER[ÆªÈ–¬]; $¿±¸×ê• = array($¨àŒç‹ù[1756] => USER_ID, $¨àŒç‹ù[557] => array($¨àŒç‹ù[2083], 0)); $ÎÌå—Ş = $¨àŒç‹ù[2494]; $ŠÙ³ŸÑ× = $this->field($ÎÌå—Ş)->where($¿±¸×ê•)->order($¨àŒç‹ù[2086])->select(); return $ŠÙ³ŸÑ× ? $ŠÙ³ŸÑ× : array(); } protected function addToTag($¿Ğº­º¹, $ëñ£Õ•·) { $íïïÂ¢± =& $_SERVER[ÆªÈ–¬]; if (!Model($íïïÂ¢±[2230])->listData($ëñ£Õ•·)) { return !1; } if (is_numeric($¿Ğº­º¹)) { $‡Šæ¯Õˆ = Model($íïïÂ¢±[890])->pathInfo($¿Ğº­º¹); if (!$‡Šæ¯Õˆ) { return !1; } } else { $‡Šæ¯Õˆ = IO::infoSimple($¿Ğº­º¹); if (!$‡Šæ¯Õˆ) { return !1; } $Ÿ­ƒæÖ§ = $‡Šæ¯Õˆ[$íïïÂ¢±[32]]; $…Â³Ô¹» = $‡Šæ¯Õˆ[$íïïÂ¢±[33]]; if (isset($‡Šæ¯Õˆ[$íïïÂ¢±[485]])) { $…Â³Ô¹» = $‡Šæ¯Õˆ[$íïïÂ¢±[485]] == $íïïÂ¢±[91] ? $íïïÂ¢±[78] : $íïïÂ¢±[230]; } } $Ä¿§å = array($íïïÂ¢±[1756] => USER_ID, $íïïÂ¢±[557] => $ëñ£Õ•·, $íïïÂ¢±[495] => $¿Ğº­º¹, $íïïÂ¢±[496] => $…Â³Ô¹» ? $…Â³Ô¹» : $íïïÂ¢±[490], $íïïÂ¢±[494] => $Ÿ­ƒæÖ§ ? $Ÿ­ƒæÖ§ : $íïïÂ¢±[12], $íïïÂ¢±[1968] => 0); if ($this->where($Ä¿§å)->find()) { return !1; } return $this->add($Ä¿§å); } protected function removeFromTag($«Õ¦ô§Œ, $üşÒ‹·é) { $¯û•¥¾¯ =& $_SERVER[ÆªÈ–¬]; if (!Model($¯û•¥¾¯[2230])->listData($üşÒ‹·é)) { return !1; } if (is_array($«Õ¦ô§Œ)) { $«Õ¦ô§Œ = array($¯û•¥¾¯[7], $«Õ¦ô§Œ); } $ÇÒÓÈİ = array($¯û•¥¾¯[1756] => USER_ID, $¯û•¥¾¯[557] => $üşÒ‹·é, $¯û•¥¾¯[495] => $«Õ¦ô§Œ); return $this->where($ÇÒÓÈİ)->delete(); } protected function removeByTag($”äé¬ŒÄ) { $¹Ê¥ºÛÓ =& $_SERVER[ÆªÈ–¬]; if (!$”äé¬ŒÄ) { return !1; } $¿ö¼ãº‚ = array($¹Ê¥ºÛÓ[1756] => USER_ID, $¹Ê¥ºÛÓ[557] => $”äé¬ŒÄ); return $this->where($¿ö¼ãº‚)->delete(); } protected function removeBySource($¨œ¢ëİù) { $ÆˆíÄû =& $_SERVER[ÆªÈ–¬]; if (is_array($¨œ¢ëİù)) { $¨œ¢ëİù = array($ÆˆíÄû[7], $¨œ¢ëİù); } $Êé¥úË« = array($ÆˆíÄû[1756] => USER_ID, $ÆˆíÄû[557] => array($ÆˆíÄû[1085], 0), $ÆˆíÄû[495] => $¨œ¢ëİù); return $this->where($Êé¥úË«)->delete(); } }